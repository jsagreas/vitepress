---
title: 1ã€MyBatisæ¡†æ¶å…¥é—¨åŸºç¡€
---
## ğŸ“š ç›®å½•

1. [ORMå¯¹è±¡å…³ç³»æ˜ å°„](#1-ORMå¯¹è±¡å…³ç³»æ˜ å°„)
2. [MyBatisæ¡†æ¶ç‰¹ç‚¹](#2-MyBatisæ¡†æ¶ç‰¹ç‚¹)
3. [SqlSessionFactoryå·¥å‚](#3-SqlSessionFactoryå·¥å‚)
4. [SqlSessionä¼šè¯](#4-SqlSessionä¼šè¯)
5. [Mapperæ¥å£ä»£ç†](#5-Mapperæ¥å£ä»£ç†)
6. [æ ¸å¿ƒé…ç½®æ–‡ä»¶](#6-æ ¸å¿ƒé…ç½®æ–‡ä»¶)
7. [æ˜ å°„é…ç½®æ–‡ä»¶](#7-æ˜ å°„é…ç½®æ–‡ä»¶)
8. [ç±»å‹åˆ«åé…ç½®](#8-ç±»å‹åˆ«åé…ç½®)
9. [æ’ä»¶æœºåˆ¶åŸç†](#9-æ’ä»¶æœºåˆ¶åŸç†)
10. [æ‰§è¡Œå™¨Executor](#10-æ‰§è¡Œå™¨Executor)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ ORMå¯¹è±¡å…³ç³»æ˜ å°„


### 1.1 ä»€ä¹ˆæ˜¯ORM


**é€šä¿—ç†è§£**ï¼šORMå°±åƒæ˜¯"ç¿»è¯‘å®˜"ï¼Œå¸®æˆ‘ä»¬åœ¨Javaå¯¹è±¡å’Œæ•°æ®åº“è¡¨ä¹‹é—´åšç¿»è¯‘ã€‚

```
æˆ‘ä»¬å†™ä»£ç æ—¶ç”¨çš„æ˜¯ï¼š               æ•°æ®åº“ä¸­å­˜çš„æ˜¯ï¼š
Userå¯¹è±¡                          userè¡¨
â”œâ”€â”€ id (æ•´æ•°)                     â”œâ”€â”€ id (æ•°å­—åˆ—)
â”œâ”€â”€ name (å­—ç¬¦ä¸²)        â†ORMâ†’    â”œâ”€â”€ name (æ–‡æœ¬åˆ—)
â””â”€â”€ age (æ•´æ•°)                    â””â”€â”€ age (æ•°å­—åˆ—)
```

**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦ORM**

åœ¨æ²¡æœ‰ORMä¹‹å‰ï¼Œæˆ‘ä»¬è¦è¿™æ ·æ“ä½œæ•°æ®åº“ï¼š

```java
// âŒ åŸå§‹JDBCæ–¹å¼ - å¾ˆç¹ç
String sql = "SELECT id, name, age FROM user WHERE id = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setInt(1, userId);
ResultSet rs = ps.executeQuery();

// æ‰‹åŠ¨æŠŠæ•°æ®åº“ç»“æœè½¬æˆJavaå¯¹è±¡
User user = new User();
if(rs.next()) {
    user.setId(rs.getInt("id"));
    user.setName(rs.getString("name"));
    user.setAge(rs.getInt("age"));
}
```

æœ‰äº†ORMä¹‹åï¼š

```java
// âœ… ä½¿ç”¨ORM - ç®€æ´å¤šäº†
User user = userMapper.selectById(userId);
```

**ğŸ“Œ ORMæ ¸å¿ƒæ¦‚å¿µ**

| æ¦‚å¿µ | **Javaä¸–ç•Œ** | **æ•°æ®åº“ä¸–ç•Œ** | **ORMåšçš„äº‹** |
|------|-------------|---------------|--------------|
| **å¯¹è±¡â†”è¡¨** | `Userç±»` | `userè¡¨` | `è‡ªåŠ¨æ˜ å°„å¯¹åº”å…³ç³»` |
| **å±æ€§â†”å­—æ®µ** | `nameå±æ€§` | `nameåˆ—` | `è‡ªåŠ¨æ•°æ®ç±»å‹è½¬æ¢` |
| **å¯¹è±¡â†”è®°å½•** | `new User()` | `ä¸€è¡Œæ•°æ®` | `è‡ªåŠ¨åˆ›å»ºå¯¹è±¡å¡«å……æ•°æ®` |

### 1.2 ORMçš„å¥½å¤„


**ğŸ¯ è®©å¼€å‘æ›´ç®€å•**
```
ä¸ç”¨ORMï¼š
å†™SQL â†’ æ‰§è¡ŒSQL â†’ æ‰‹åŠ¨å–æ•°æ® â†’ æ‰‹åŠ¨å°è£…å¯¹è±¡

ç”¨äº†ORMï¼š
è°ƒç”¨æ–¹æ³• â†’ è‡ªåŠ¨å®Œæˆæ‰€æœ‰æ­¥éª¤
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**

```java
// åœºæ™¯1: æŸ¥è¯¢ç”¨æˆ·
User user = mapper.selectById(1);  // ORMè‡ªåŠ¨è½¬æ¢

// åœºæ™¯2: ä¿å­˜ç”¨æˆ·
User newUser = new User("å¼ ä¸‰", 25);
mapper.insert(newUser);  // ORMè‡ªåŠ¨ç”ŸæˆINSERTè¯­å¥

// åœºæ™¯3: æ›´æ–°ç”¨æˆ·
user.setAge(26);
mapper.update(user);  // ORMè‡ªåŠ¨ç”ŸæˆUPDATEè¯­å¥
```

---

## 2. â­ MyBatisæ¡†æ¶ç‰¹ç‚¹


### 2.1 MyBatisæ˜¯ä»€ä¹ˆ


**ğŸ”¸ ä¸€å¥è¯ç†è§£**ï¼šMyBatisæ˜¯ä¸€ä¸ªå¸®æˆ‘ä»¬ç®€åŒ–æ•°æ®åº“æ“ä½œçš„Javaæ¡†æ¶ï¼Œå®ƒæ˜¯"åŠè‡ªåŠ¨"çš„ORMå·¥å…·ã€‚

**ä¸ºä»€ä¹ˆè¯´"åŠè‡ªåŠ¨"**ï¼Ÿ

```
å…¨è‡ªåŠ¨ORM (å¦‚Hibernate):
ä½ åªç®¡ç”¨Javaå¯¹è±¡ï¼ŒSQLéƒ½å¸®ä½ ç”Ÿæˆ

åŠè‡ªåŠ¨ORM (MyBatis):
SQLéœ€è¦ä½ è‡ªå·±å†™ï¼Œä½†ç»“æœä¼šè‡ªåŠ¨è½¬æˆJavaå¯¹è±¡
```

### 2.2 MyBatisæ ¸å¿ƒä¼˜åŠ¿


**âœ… ä¼˜åŠ¿å¯¹æ¯”è¡¨**

| ç‰¹ç‚¹ | **è¯´æ˜** | **å¥½å¤„** |
|------|---------|---------|
| **SQLå¯æ§** | `æˆ‘ä»¬è‡ªå·±å†™SQLè¯­å¥` | `å¯ä»¥åšå¤æ‚æŸ¥è¯¢å’Œä¼˜åŒ–` |
| **çµæ´»æ˜ å°„** | `ç»“æœè‡ªåŠ¨è½¬Javaå¯¹è±¡` | `ä¸ç”¨æ‰‹å†™æ•°æ®è½¬æ¢ä»£ç ` |
| **ç®€å•æ˜“å­¦** | `é…ç½®ç®€å•ï¼Œä¸Šæ‰‹å¿«` | `æ–°æ‰‹ä¹Ÿèƒ½å¿«é€Ÿä½¿ç”¨` |
| **æ€§èƒ½å¥½** | `ç›´æ¥æ‰§è¡ŒSQL` | `æ¯”å…¨è‡ªåŠ¨ORMå¿«` |

**ğŸ” é€‚ç”¨åœºæ™¯**

```
âœ… é€‚åˆMyBatisçš„æƒ…å†µï¼š
â€¢ éœ€è¦å†™å¤æ‚SQLæŸ¥è¯¢
â€¢ å¯¹SQLæ€§èƒ½è¦æ±‚é«˜
â€¢ æ•°æ®åº“è¡¨ç»“æ„å·²ç»ç¡®å®š
â€¢ éœ€è¦ç²¾ç¡®æ§åˆ¶SQLæ‰§è¡Œ

âŒ ä¸å¤ªé€‚åˆçš„æƒ…å†µï¼š
â€¢ å¸Œæœ›å®Œå…¨ä¸å†™SQL
â€¢ é¢‘ç¹æ”¹åŠ¨è¡¨ç»“æ„
â€¢ è¿½æ±‚æç®€å¼€å‘
```

### 2.3 MyBatiså·¥ä½œæµç¨‹


**ğŸ“Š æ•´ä½“æµç¨‹å›¾**

```
[1] è¯»å–é…ç½®
    â†“
[2] åˆ›å»ºSqlSessionFactory (å·¥å‚)
    â†“
[3] åˆ›å»ºSqlSession (ä¼šè¯)
    â†“
[4] è·å–Mapperæ¥å£
    â†“
[5] æ‰§è¡ŒSQL
    â†“
[6] è¿”å›ç»“æœ
```

**ğŸ’¡ ç”¨å¤§ç™½è¯è§£é‡Š**

```
å°±åƒå»é¤å…åƒé¥­ï¼š
[1] çœ‹èœå• (è¯»é…ç½®) â†’ çŸ¥é“æœ‰ä»€ä¹ˆèœ
[2] è¿›å…¥é¤å… (å·¥å‚) â†’ æœ‰åšèœçš„èƒ½åŠ›
[3] åä¸‹ç‚¹èœ (ä¼šè¯) â†’ å¼€å§‹ä¸€æ¬¡ç”¨é¤è¿‡ç¨‹
[4] å«æœåŠ¡å‘˜ (Mapper) â†’ å¸®ä½ ä¼ é€’éœ€æ±‚
[5] å¨å¸ˆåšèœ (æ‰§è¡ŒSQL) â†’ å¤„ç†ä½ çš„è¯·æ±‚
[6] ä¸Šèœ (è¿”å›ç»“æœ) â†’ å¾—åˆ°ä½ è¦çš„ä¸œè¥¿
```

---

## 3. ğŸ­ SqlSessionFactoryå·¥å‚


### 3.1 å·¥å‚æ˜¯ä»€ä¹ˆ


**ğŸ”¸ é€šä¿—ç†è§£**ï¼šSqlSessionFactoryå°±åƒä¸€ä¸ª"ç”Ÿäº§è½¦é—´"ï¼Œä¸“é—¨ç”¨æ¥ç”Ÿäº§SqlSessionï¼ˆä¼šè¯ï¼‰ã€‚

**ä¸ºä»€ä¹ˆå«"å·¥å‚"**ï¼Ÿ

```
ç°å®ä¸­çš„å·¥å‚ï¼š
åŸææ–™ â†’ å·¥å‚ â†’ äº§å“

MyBatisçš„å·¥å‚ï¼š
é…ç½®ä¿¡æ¯ â†’ SqlSessionFactory â†’ SqlSession
```

### 3.2 å¦‚ä½•åˆ›å»ºå·¥å‚


**ğŸ“ åˆ›å»ºæ­¥éª¤**

```java
// æ­¥éª¤1: è¯»å–é…ç½®æ–‡ä»¶
String resource = "mybatis-config.xml";
InputStream inputStream = Resources.getResourceAsStream(resource);

// æ­¥éª¤2: åˆ›å»ºå·¥å‚
SqlSessionFactory factory = new SqlSessionFactoryBuilder()
    .build(inputStream);
```

**ğŸ” é…ç½®æ–‡ä»¶ç¤ºä¾‹ (mybatis-config.xml)**

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!-- æ•°æ®åº“è¿æ¥ä¿¡æ¯ -->
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3306/mydb"/>
                <property name="username" value="root"/>
                <property name="password" value="123456"/>
            </dataSource>
        </environment>
    </environments>
    
    <!-- æ˜ å°„æ–‡ä»¶ä½ç½® -->
    <mappers>
        <mapper resource="mappers/UserMapper.xml"/>
    </mappers>
</configuration>
```

### 3.3 å·¥å‚çš„é‡è¦ç‰¹ç‚¹


**âš ï¸ æ³¨æ„äº‹é¡¹**

| ç‰¹ç‚¹ | **è¯´æ˜** | **æœ€ä½³å®è·µ** |
|------|---------|-------------|
| **å•ä¾‹æ¨¡å¼** | `æ•´ä¸ªåº”ç”¨åªéœ€è¦ä¸€ä¸ªå·¥å‚` | `åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºä¸€æ¬¡` |
| **çº¿ç¨‹å®‰å…¨** | `å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±ç”¨` | `å¯ä»¥è®¾ä¸ºé™æ€å˜é‡` |
| **é‡é‡çº§å¯¹è±¡** | `åˆ›å»ºå¼€é”€å¤§` | `ä¸è¦é¢‘ç¹åˆ›å»ºé”€æ¯` |

**âœ… æ­£ç¡®ç”¨æ³•**

```java
// âœ… æ¨èï¼šåº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºä¸€æ¬¡
public class MyBatisUtil {
    private static SqlSessionFactory factory;
    
    static {
        try {
            String resource = "mybatis-config.xml";
            InputStream inputStream = Resources.getResourceAsStream(resource);
            factory = new SqlSessionFactoryBuilder().build(inputStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    
    public static SqlSessionFactory getFactory() {
        return factory;
    }
}

// âŒ é”™è¯¯ï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°å·¥å‚
public void doSomething() {
    SqlSessionFactory factory = new SqlSessionFactoryBuilder()
        .build(inputStream);  // ä¸è¦è¿™æ ·åšï¼
}
```

---

## 4. ğŸ’¬ SqlSessionä¼šè¯


### 4.1 ä¼šè¯æ˜¯ä»€ä¹ˆ


**ğŸ”¸ å½¢è±¡ç†è§£**ï¼šSqlSessionå°±åƒä½ å’Œæ•°æ®åº“ä¹‹é—´çš„"ç”µè¯é€šè¯"ï¼Œé€šè¯æœŸé—´å¯ä»¥æ‰§è¡Œå¤šä¸ªæ“ä½œã€‚

```
æ‰“ç”µè¯æµç¨‹ï¼š                    SqlSessionæµç¨‹ï¼š
æ‹¨å· â†’ æ¥é€š                    åˆ›å»º â†’ å»ºç«‹è¿æ¥
è¯´è¯ â†’ æ²Ÿé€š                    æ‰§è¡ŒSQL â†’ æ“ä½œæ•°æ®åº“
æŒ‚æœº â†’ ç»“æŸ                    å…³é—­ â†’ é‡Šæ”¾èµ„æº
```

### 4.2 å¦‚ä½•ä½¿ç”¨ä¼šè¯


**ğŸ“ æ ‡å‡†ä½¿ç”¨æµç¨‹**

```java
// æ–¹å¼1: æ‰‹åŠ¨å…³é—­ (ä¼ ç»Ÿå†™æ³•)
SqlSession session = factory.openSession();
try {
    // æ‰§è¡Œæ•°æ®åº“æ“ä½œ
    UserMapper mapper = session.getMapper(UserMapper.class);
    User user = mapper.selectById(1);
    
    // æäº¤äº‹åŠ¡
    session.commit();
} catch (Exception e) {
    // å‡ºé”™å›æ»š
    session.rollback();
} finally {
    // å¿…é¡»å…³é—­
    session.close();
}

// æ–¹å¼2: è‡ªåŠ¨å…³é—­ (æ¨èå†™æ³•)
try (SqlSession session = factory.openSession()) {
    UserMapper mapper = session.getMapper(UserMapper.class);
    User user = mapper.selectById(1);
    session.commit();
} // è‡ªåŠ¨å…³é—­ï¼Œä¸ç”¨å†™finally
```

### 4.3 ä¼šè¯çš„æ ¸å¿ƒæ–¹æ³•


**ğŸ”§ å¸¸ç”¨æ“ä½œæ–¹æ³•**

| æ–¹æ³• | **ä½œç”¨** | **ç¤ºä¾‹** |
|------|---------|---------|
| `getMapper()` | `è·å–Mapperæ¥å£` | `UserMapper mapper = session.getMapper(UserMapper.class)` |
| `commit()` | `æäº¤äº‹åŠ¡` | `session.commit()` |
| `rollback()` | `å›æ»šäº‹åŠ¡` | `session.rollback()` |
| `close()` | `å…³é—­ä¼šè¯` | `session.close()` |

**ğŸ’¡ äº‹åŠ¡ç®¡ç†ç¤ºä¾‹**

```java
// åœºæ™¯ï¼šè½¬è´¦æ“ä½œ
SqlSession session = factory.openSession();
try {
    AccountMapper mapper = session.getMapper(AccountMapper.class);
    
    // ä»Aè´¦æˆ·æ‰£é’±
    mapper.decreaseMoney("A", 100);
    
    // æ¨¡æ‹Ÿå¼‚å¸¸
    // int i = 1/0;
    
    // ç»™Bè´¦æˆ·åŠ é’±
    mapper.increaseMoney("B", 100);
    
    // éƒ½æˆåŠŸæ‰æäº¤
    session.commit();
    
} catch (Exception e) {
    // å‡ºé”™å…¨éƒ¨å›æ»š
    session.rollback();
} finally {
    session.close();
}
```

### 4.4 ä¼šè¯çš„é‡è¦ç‰¹æ€§


**âš ï¸ å¿…çŸ¥äº‹é¡¹**

```
ğŸ”´ ä¼šè¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„
â€¢ æ¯ä¸ªçº¿ç¨‹è¦æœ‰è‡ªå·±çš„SqlSession
â€¢ ä¸èƒ½å¤šä¸ªçº¿ç¨‹å…±ç”¨ä¸€ä¸ªSqlSession

ğŸŸ¡ ä¼šè¯è¦åŠæ—¶å…³é—­
â€¢ ç”¨å®Œå¿…é¡»å…³é—­ï¼Œå¦åˆ™å ç”¨è¿æ¥
â€¢ æ¨èä½¿ç”¨ try-with-resources

ğŸŸ¢ é»˜è®¤ä¸è‡ªåŠ¨æäº¤
â€¢ ä¿®æ”¹æ•°æ®åè¦æ‰‹åŠ¨commit()
â€¢ æˆ–è€…åˆ›å»ºæ—¶è®¾ç½®è‡ªåŠ¨æäº¤: openSession(true)
```

---

## 5. ğŸ”Œ Mapperæ¥å£ä»£ç†


### 5.1 ä»€ä¹ˆæ˜¯Mapperæ¥å£


**ğŸ”¸ ç®€å•ç†è§£**ï¼šMapperæ¥å£å°±æ˜¯ä½ å®šä¹‰çš„"æ“ä½œæ‰‹å†Œ"ï¼Œå‘Šè¯‰MyBatisä½ è¦åšä»€ä¹ˆæ•°æ®åº“æ“ä½œã€‚

**ä¸ºä»€ä¹ˆç”¨æ¥å£**ï¼Ÿ

```
ä¼ ç»Ÿæ–¹å¼ï¼š
session.selectOne("namespace.selectUser", 1);  // å®¹æ˜“å†™é”™

Mapperæ–¹å¼ï¼š
UserMapper mapper = session.getMapper(UserMapper.class);
User user = mapper.selectById(1);  // ç±»å‹å®‰å…¨ï¼ŒIDEæœ‰æç¤º
```

### 5.2 æ¥å£ä»£ç†å·¥ä½œåŸç†


**ğŸ“Š ä»£ç†æµç¨‹å›¾**

```
ä½ è°ƒç”¨æ–¹æ³•                    MyBatisåšçš„äº‹
    â†“                            â†“
mapper.selectById(1)    â†’    [1] æ‰¾åˆ°å¯¹åº”çš„SQL
    â†“                            â†“
                              [2] è®¾ç½®å‚æ•°
    â†“                            â†“
                              [3] æ‰§è¡ŒSQL
    â†“                            â†“
è¿”å›Userå¯¹è±¡            â†    [4] ç»“æœè½¬æ¢
```

**ğŸ’¡ ç”¨å¤§ç™½è¯è¯´**

```
ä½ ï¼šmapperï¼Œå¸®æˆ‘æŸ¥IDä¸º1çš„ç”¨æˆ·
MyBatisï¼šå¥½çš„ï¼Œæˆ‘æ‰¾åˆ°SQLäº†
        æŠŠå‚æ•°1ä¼ è¿›å»
        æ‰§è¡ŒæŸ¥è¯¢
        æŠŠç»“æœè½¬æˆUserå¯¹è±¡
        ç»™ä½ ï¼
```

### 5.3 å¦‚ä½•å®šä¹‰Mapperæ¥å£


**ğŸ“ æ­¥éª¤1ï¼šåˆ›å»ºæ¥å£**

```java
public interface UserMapper {
    
    // æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
    User selectById(int id);
    
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    List<User> selectAll();
    
    // æ’å…¥ç”¨æˆ·
    int insert(User user);
    
    // æ›´æ–°ç”¨æˆ·
    int update(User user);
    
    // åˆ é™¤ç”¨æˆ·
    int delete(int id);
}
```

**ğŸ“ æ­¥éª¤2ï¼šåˆ›å»ºXMLæ˜ å°„æ–‡ä»¶**

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespaceå¿…é¡»æ˜¯æ¥å£çš„å…¨é™å®šå -->
<mapper namespace="com.example.mapper.UserMapper">
    
    <!-- idå¿…é¡»æ˜¯æ¥å£ä¸­çš„æ–¹æ³•å -->
    <select id="selectById" resultType="com.example.entity.User">
        SELECT * FROM user WHERE id = #{id}
    </select>
    
    <select id="selectAll" resultType="com.example.entity.User">
        SELECT * FROM user
    </select>
    
    <insert id="insert">
        INSERT INTO user(name, age) VALUES(#{name}, #{age})
    </insert>
</mapper>
```

### 5.4 Mapperçš„ä½¿ç”¨è§„èŒƒ


**âœ… æ¥å£æ–¹æ³•ä¸XMLå¯¹åº”å…³ç³»**

| æ¥å£éƒ¨åˆ† | **XMLéƒ¨åˆ†** | **å¿…é¡»ä¸€è‡´** |
|---------|------------|-------------|
| `æ¥å£å…¨é™å®šå` | `<mapper namespace="">` | `åŒ…å+ç±»åè¦å®Œå…¨ç›¸åŒ` |
| `æ–¹æ³•å` | `<select/insert id="">` | `æ–¹æ³•åå’Œidè¦ä¸€æ ·` |
| `å‚æ•°ç±»å‹` | `parameterType` | `å¯ä»¥çœç•¥ï¼Œä¼šè‡ªåŠ¨è¯†åˆ«` |
| `è¿”å›ç±»å‹` | `resultType` | `è¦åŒ¹é…æ–¹æ³•è¿”å›ç±»å‹` |

**ğŸ” å¸¸è§é”™è¯¯**

```java
// âŒ é”™è¯¯ç¤ºä¾‹
<mapper namespace="UserMapper">  // ç¼ºå°‘åŒ…å
<select id="getById">  // æ–¹æ³•åæ˜¯selectByIdï¼Œè¿™é‡Œå†™é”™äº†

// âœ… æ­£ç¡®ç¤ºä¾‹
<mapper namespace="com.example.mapper.UserMapper">
<select id="selectById" resultType="com.example.entity.User">
```

---

## 6. âš™ï¸ æ ¸å¿ƒé…ç½®æ–‡ä»¶


### 6.1 é…ç½®æ–‡ä»¶ä½œç”¨


**ğŸ”¸ æ ¸å¿ƒé…ç½®æ–‡ä»¶ (mybatis-config.xml)**ï¼šè¿™æ˜¯MyBatisçš„"æ€»è®¾ç½®"ï¼Œå‘Šè¯‰å®ƒæ€ä¹ˆå·¥ä½œã€‚

**ğŸ“Œ é…ç½®æ–‡ä»¶åŒ…å«çš„å†…å®¹**

```
[1] å…¨å±€è®¾ç½®          â†’ é©¼å³°å‘½åã€ç¼“å­˜å¼€å…³ç­‰
[2] ç±»å‹åˆ«å          â†’ ç®€åŒ–ç±»åå†™æ³•
[3] æ•°æ®åº“è¿æ¥        â†’ è¿å“ªä¸ªæ•°æ®åº“
[4] æ˜ å°„æ–‡ä»¶ä½ç½®      â†’ SQLå†™åœ¨å“ªé‡Œ
[5] æ’ä»¶é…ç½®          â†’ æ‰©å±•åŠŸèƒ½
```

### 6.2 é…ç½®æ–‡ä»¶ç»“æ„


**ğŸ“Š æ ‡ç­¾é¡ºåºå¿…é¡»éµå®ˆ**

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    
    <!-- â‘ å±æ€§é…ç½® -->
    <properties resource="db.properties"/>
    
    <!-- â‘¡å…¨å±€è®¾ç½® -->
    <settings>
        <setting name="mapUnderscoreToCamelCase" value="true"/>
    </settings>
    
    <!-- â‘¢ç±»å‹åˆ«å -->
    <typeAliases>
        <typeAlias type="com.example.entity.User" alias="User"/>
    </typeAliases>
    
    <!-- â‘£ç¯å¢ƒé…ç½® -->
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="${jdbc.driver}"/>
                <property name="url" value="${jdbc.url}"/>
                <property name="username" value="${jdbc.username}"/>
                <property name="password" value="${jdbc.password}"/>
            </dataSource>
        </environment>
    </environments>
    
    <!-- â‘¤æ˜ å°„å™¨ -->
    <mappers>
        <mapper resource="mappers/UserMapper.xml"/>
    </mappers>
    
</configuration>
```

**âš ï¸ æ³¨æ„ï¼šæ ‡ç­¾é¡ºåºå›ºå®šï¼Œä¸èƒ½é¢ å€’ï¼**

### 6.3 é‡è¦é…ç½®é¡¹è¯¦è§£


**ğŸ”§ settings å…¨å±€è®¾ç½®**

| é…ç½®é¡¹ | **ä½œç”¨** | **æ¨èå€¼** |
|--------|---------|-----------|
| `mapUnderscoreToCamelCase` | `ä¸‹åˆ’çº¿è½¬é©¼å³°` | `true` |
| `cacheEnabled` | `å¼€å¯äºŒçº§ç¼“å­˜` | `true` |
| `lazyLoadingEnabled` | `å»¶è¿ŸåŠ è½½` | `false` |
| `logImpl` | `æ—¥å¿—å®ç°` | `STDOUT_LOGGING` |

**ğŸ’¡ é©¼å³°å‘½åç¤ºä¾‹**

```
æ•°æ®åº“å­—æ®µï¼šuser_name, create_time
Javaå±æ€§ï¼š  userName, createTime

å¼€å¯é©¼å³°è½¬æ¢åè‡ªåŠ¨å¯¹åº”ï¼Œä¸ç”¨æ‰‹å†™æ˜ å°„
```

**ğŸ”§ environments ç¯å¢ƒé…ç½®**

```xml
<!-- å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ -->
<environments default="development">
    
    <!-- å¼€å‘ç¯å¢ƒ -->
    <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
            <property name="driver" value="com.mysql.jdbc.Driver"/>
            <property name="url" value="jdbc:mysql://localhost:3306/dev_db"/>
        </dataSource>
    </environment>
    
    <!-- ç”Ÿäº§ç¯å¢ƒ -->
    <environment id="production">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
            <property name="url" value="jdbc:mysql://prod-server:3306/prod_db"/>
        </dataSource>
    </environment>
    
</environments>
```

### 6.4 å¤–éƒ¨å±æ€§æ–‡ä»¶


**ğŸ“ db.properties æ–‡ä»¶**

```properties
jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/mydb
jdbc.username=root
jdbc.password=123456
```

**ğŸ“ åœ¨é…ç½®ä¸­ä½¿ç”¨**

```xml
<configuration>
    <!-- å¼•å…¥å¤–éƒ¨é…ç½® -->
    <properties resource="db.properties"/>
    
    <environments default="development">
        <environment id="development">
            <dataSource type="POOLED">
                <!-- ä½¿ç”¨${key}å¼•ç”¨ -->
                <property name="driver" value="${jdbc.driver}"/>
                <property name="url" value="${jdbc.url}"/>
                <property name="username" value="${jdbc.username}"/>
                <property name="password" value="${jdbc.password}"/>
            </dataSource>
        </environment>
    </environments>
</configuration>
```

---

## 7. ğŸ“„ æ˜ å°„é…ç½®æ–‡ä»¶


### 7.1 æ˜ å°„æ–‡ä»¶æ˜¯ä»€ä¹ˆ


**ğŸ”¸ é€šä¿—ç†è§£**ï¼šæ˜ å°„æ–‡ä»¶å°±æ˜¯"SQLè„šæœ¬åº“"ï¼Œé‡Œé¢å­˜æ”¾ç€å„ç§SQLè¯­å¥å’Œç»“æœæ˜ å°„è§„åˆ™ã€‚

**æ–‡ä»¶å‘½åè§„èŒƒ**

```
é€šå¸¸å‘½åä¸º: XxxMapper.xml
ä¾‹å¦‚ï¼š
UserMapper.xml    â†’ ç”¨æˆ·ç›¸å…³SQL
OrderMapper.xml   â†’ è®¢å•ç›¸å…³SQL
ProductMapper.xml â†’ å•†å“ç›¸å…³SQL
```

### 7.2 åŸºæœ¬æ ‡ç­¾ä»‹ç»


**ğŸ“Œ å››å¤§æ ¸å¿ƒæ ‡ç­¾**

| æ ‡ç­¾ | **ç”¨é€”** | **å¸¸ç”¨å±æ€§** |
|------|---------|-------------|
| `<select>` | `æŸ¥è¯¢è¯­å¥` | `id, resultType, resultMap` |
| `<insert>` | `æ’å…¥è¯­å¥` | `id, parameterType, useGeneratedKeys` |
| `<update>` | `æ›´æ–°è¯­å¥` | `id, parameterType` |
| `<delete>` | `åˆ é™¤è¯­å¥` | `id, parameterType` |

### 7.3 å‚æ•°ä¼ é€’æ–¹å¼


**ğŸ” å•ä¸ªå‚æ•°**

```xml
<!-- æ¥å£æ–¹æ³•ï¼šUser selectById(int id) -->
<select id="selectById" resultType="User">
    <!-- #{id}ä¼šè‡ªåŠ¨è·å–å‚æ•°å€¼ -->
    SELECT * FROM user WHERE id = #{id}
</select>
```

**ğŸ” å¤šä¸ªå‚æ•°**

```xml
<!-- æ¥å£æ–¹æ³•ï¼šUser selectByNameAndAge(String name, int age) -->
<select id="selectByNameAndAge" resultType="User">
    <!-- å¤šä¸ªå‚æ•°ç”¨@Paramæ³¨è§£æˆ–param1, param2 -->
    SELECT * FROM user 
    WHERE name = #{param1} AND age = #{param2}
</select>
```

```java
// æ¥å£ä¸­ä½¿ç”¨@Paramæ³¨è§£
User selectByNameAndAge(@Param("name") String name, 
                        @Param("age") int age);
```

```xml
<!-- æ­¤æ—¶å¯ä»¥ç”¨æ³¨è§£ä¸­çš„åç§° -->
<select id="selectByNameAndAge" resultType="User">
    SELECT * FROM user 
    WHERE name = #{name} AND age = #{age}
</select>
```

**ğŸ” å¯¹è±¡å‚æ•°**

```xml
<!-- æ¥å£æ–¹æ³•ï¼šint insert(User user) -->
<insert id="insert">
    <!-- #{å±æ€§å}ä¼šè°ƒç”¨å¯¹è±¡çš„getæ–¹æ³• -->
    INSERT INTO user(name, age) 
    VALUES(#{name}, #{age})
</insert>
```

### 7.4 ç»“æœæ˜ å°„


**æ–¹å¼1ï¼šè‡ªåŠ¨æ˜ å°„ (resultType)**

```xml
<!-- å­—æ®µåå’Œå±æ€§åä¸€è‡´æ—¶ï¼Œè‡ªåŠ¨æ˜ å°„ -->
<select id="selectById" resultType="User">
    SELECT id, name, age FROM user WHERE id = #{id}
</select>
```

**æ–¹å¼2ï¼šæ‰‹åŠ¨æ˜ å°„ (resultMap)**

```xml
<!-- å­—æ®µåå’Œå±æ€§åä¸ä¸€è‡´æ—¶ï¼Œæ‰‹åŠ¨æ˜ å°„ -->
<resultMap id="userMap" type="User">
    <id column="user_id" property="id"/>
    <result column="user_name" property="name"/>
    <result column="user_age" property="age"/>
</resultMap>

<select id="selectById" resultMap="userMap">
    SELECT user_id, user_name, user_age 
    FROM t_user WHERE user_id = #{id}
</select>
```

### 7.5 åŠ¨æ€SQL


**ğŸ”§ å¸¸ç”¨åŠ¨æ€æ ‡ç­¾**

```xml
<!-- if æ ‡ç­¾ï¼šæ¡ä»¶åˆ¤æ–­ -->
<select id="selectByCondition" resultType="User">
    SELECT * FROM user WHERE 1=1
    <if test="name != null">
        AND name = #{name}
    </if>
    <if test="age != null">
        AND age = #{age}
    </if>
</select>

<!-- where æ ‡ç­¾ï¼šè‡ªåŠ¨å¤„ç†AND/OR -->
<select id="selectByCondition2" resultType="User">
    SELECT * FROM user
    <where>
        <if test="name != null">
            AND name = #{name}
        </if>
        <if test="age != null">
            AND age = #{age}
        </if>
    </where>
</select>

<!-- foreach æ ‡ç­¾ï¼šå¾ªç¯ -->
<select id="selectByIds" resultType="User">
    SELECT * FROM user WHERE id IN
    <foreach collection="ids" item="id" open="(" separator="," close=")">
        #{id}
    </foreach>
</select>
```

---

## 8. ğŸ·ï¸ ç±»å‹åˆ«åé…ç½®


### 8.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ«å


**ğŸ”¸ é—®é¢˜åœºæ™¯**

```xml
<!-- âŒ æ²¡æœ‰åˆ«åï¼šç±»åå¤ªé•¿ï¼Œå†™èµ·æ¥éº»çƒ¦ -->
<select id="selectById" resultType="com.example.entity.User">
    SELECT * FROM user WHERE id = #{id}
</select>

<!-- âœ… ä½¿ç”¨åˆ«åï¼šç®€æ´æ˜äº† -->
<select id="selectById" resultType="User">
    SELECT * FROM user WHERE id = #{id}
</select>
```

### 8.2 é…ç½®æ–¹å¼


**æ–¹å¼1ï¼šå•ä¸ªåˆ«å**

```xml
<typeAliases>
    <!-- typeæ˜¯å®Œæ•´ç±»åï¼Œaliasæ˜¯åˆ«å -->
    <typeAlias type="com.example.entity.User" alias="User"/>
    <typeAlias type="com.example.entity.Order" alias="Order"/>
</typeAliases>
```

**æ–¹å¼2ï¼šåŒ…æ‰«æ (æ¨è)**

```xml
<typeAliases>
    <!-- æ‰«ææ•´ä¸ªåŒ…ï¼Œç±»åå°±æ˜¯åˆ«å(ä¸åŒºåˆ†å¤§å°å†™) -->
    <package name="com.example.entity"/>
</typeAliases>
```

```
æ‰«æåè‡ªåŠ¨ç”Ÿæˆï¼š
Userç±»    â†’ åˆ«åï¼šUser (æˆ–user, USERéƒ½å¯ä»¥)
Orderç±»   â†’ åˆ«åï¼šOrder
Productç±» â†’ åˆ«åï¼šProduct
```

### 8.3 MyBatiså†…ç½®åˆ«å


**ğŸ“‹ å¸¸ç”¨å†…ç½®åˆ«å**

| Javaç±»å‹ | **åˆ«å** | **ç¤ºä¾‹** |
|---------|---------|---------|
| `int / Integer` | `int, integer` | `resultType="int"` |
| `long / Long` | `long` | `resultType="long"` |
| `String` | `string` | `resultType="string"` |
| `Map` | `map` | `resultType="map"` |
| `List` | `list` | â€”â€” |

**ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹**

```xml
<!-- æŸ¥è¯¢æ•°é‡ï¼Œè¿”å›int -->
<select id="count" resultType="int">
    SELECT COUNT(*) FROM user
</select>

<!-- æŸ¥è¯¢å•ä¸ªå­—æ®µï¼Œè¿”å›String -->
<select id="selectName" resultType="string">
    SELECT name FROM user WHERE id = #{id}
</select>

<!-- è¿”å›Map -->
<select id="selectMap" resultType="map">
    SELECT * FROM user WHERE id = #{id}
</select>
```

---

## 9. ğŸ”Œ æ’ä»¶æœºåˆ¶åŸç†


### 9.1 ä»€ä¹ˆæ˜¯æ’ä»¶


**ğŸ”¸ å½¢è±¡ç†è§£**ï¼šæ’ä»¶å°±åƒç»™MyBatisè£…äº†"å¤–æŒ‚"ï¼Œå¯ä»¥åœ¨SQLæ‰§è¡Œå‰ååšä¸€äº›é¢å¤–çš„äº‹æƒ…ã€‚

**å¸¸è§æ’ä»¶åŠŸèƒ½**

```
ğŸ”¸ åˆ†é¡µæ’ä»¶     â†’ è‡ªåŠ¨å¤„ç†åˆ†é¡µSQL
ğŸ”¸ æ€§èƒ½ç›‘æ§     â†’ è®°å½•SQLæ‰§è¡Œæ—¶é—´
ğŸ”¸ æ•°æ®åŠ å¯†     â†’ è‡ªåŠ¨åŠ å¯†æ•æ„Ÿæ•°æ®
ğŸ”¸ æƒé™æ§åˆ¶     â†’ æ ¹æ®æƒé™è¿‡æ»¤æ•°æ®
```

### 9.2 æ’ä»¶å·¥ä½œåŸç†


**ğŸ“Š æ‰§è¡Œæµç¨‹**

```
æ­£å¸¸æ‰§è¡Œæµç¨‹ï¼š
Mapperæ–¹æ³• â†’ Executor â†’ StatementHandler â†’ SQLæ‰§è¡Œ

æ’ä»¶ä»‹å…¥åï¼š
Mapperæ–¹æ³• â†’ [æ’ä»¶æ‹¦æˆª] â†’ Executor â†’ [æ’ä»¶æ‹¦æˆª] 
         â†’ StatementHandler â†’ [æ’ä»¶æ‹¦æˆª] â†’ SQLæ‰§è¡Œ
```

**ğŸ’¡ å¯ä»¥æ‹¦æˆªçš„å¯¹è±¡**

| å¯¹è±¡ | **ä½œç”¨æ—¶æœº** | **èƒ½åšä»€ä¹ˆ** |
|------|------------|-------------|
| `Executor` | `æ‰§è¡ŒSQLå‰` | `ä¿®æ”¹SQLã€è®°å½•æ—¥å¿—` |
| `StatementHandler` | `å‡†å¤‡è¯­å¥å‰` | `ä¿®æ”¹SQLã€è®¾ç½®å‚æ•°` |
| `ParameterHandler` | `è®¾ç½®å‚æ•°æ—¶` | `å‚æ•°åŠ å¯†ã€è½¬æ¢` |
| `ResultSetHandler` | `å¤„ç†ç»“æœæ—¶` | `ç»“æœè§£å¯†ã€è½¬æ¢` |

### 9.3 åˆ†é¡µæ’ä»¶ç¤ºä¾‹


**ğŸ“ ä½¿ç”¨PageHelperåˆ†é¡µæ’ä»¶**

```xml
<!-- 1. é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ’ä»¶ -->
<plugins>
    <plugin interceptor="com.github.pagehelper.PageInterceptor">
        <property name="helperDialect" value="mysql"/>
    </plugin>
</plugins>
```

```java
// 2. ä»£ç ä¸­ä½¿ç”¨
// è®¾ç½®åˆ†é¡µå‚æ•°ï¼šç¬¬1é¡µï¼Œæ¯é¡µ10æ¡
PageHelper.startPage(1, 10);

// æ‰§è¡ŒæŸ¥è¯¢
List<User> users = userMapper.selectAll();

// è·å–åˆ†é¡µä¿¡æ¯
PageInfo<User> pageInfo = new PageInfo<>(users);
System.out.println("æ€»è®°å½•æ•°ï¼š" + pageInfo.getTotal());
System.out.println("æ€»é¡µæ•°ï¼š" + pageInfo.getPages());
```

**ğŸ” æ’ä»¶åšäº†ä»€ä¹ˆ**

```
åŸå§‹SQLï¼š
SELECT * FROM user

æ’ä»¶è‡ªåŠ¨æ”¹æˆï¼š
SELECT * FROM user LIMIT 0, 10
```

### 9.4 è‡ªå®šä¹‰æ’ä»¶


**ğŸ“ ç¼–å†™ç®€å•çš„æ—¥å¿—æ’ä»¶**

```java
@Intercepts({
    @Signature(
        type = Executor.class,
        method = "update",
        args = {MappedStatement.class, Object.class}
    )
})
public class MyLogPlugin implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        // SQLæ‰§è¡Œå‰
        System.out.println("SQLæ‰§è¡Œå‰...");
        long start = System.currentTimeMillis();
        
        // æ‰§è¡ŒSQL
        Object result = invocation.proceed();
        
        // SQLæ‰§è¡Œå
        long end = System.currentTimeMillis();
        System.out.println("SQLæ‰§è¡Œè€—æ—¶ï¼š" + (end - start) + "ms");
        
        return result;
    }
}
```

---

## 10. âš¡ æ‰§è¡Œå™¨Executor


### 10.1 æ‰§è¡Œå™¨æ˜¯ä»€ä¹ˆ


**ğŸ”¸ é€šä¿—ç†è§£**ï¼šExecutoræ˜¯MyBatisçš„"å¹²æ´»çš„äºº"ï¼Œæ‰€æœ‰SQLéƒ½æ˜¯å®ƒå»æ‰§è¡Œçš„ã€‚

**åœ¨æ•´ä½“æ¶æ„ä¸­çš„ä½ç½®**

```
SqlSession (ä¼šè¯)
    â†“ è°ƒç”¨
Executor (æ‰§è¡Œå™¨) â† ä½ åœ¨è¿™é‡Œ
    â†“ ä½¿ç”¨
StatementHandler (è¯­å¥å¤„ç†å™¨)
    â†“ æ‰§è¡Œ
JDBC (æ•°æ®åº“æ“ä½œ)
```

### 10.2 ä¸‰ç§æ‰§è¡Œå™¨ç±»å‹


**ğŸ“‹ æ‰§è¡Œå™¨å¯¹æ¯”**

| ç±»å‹ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|-------------|
| **SimpleExecutor** | `ç®€å•æ‰§è¡Œå™¨` | `é»˜è®¤ï¼Œæ¯æ¬¡éƒ½åˆ›å»ºæ–°Statement` |
| **ReuseExecutor** | `é‡ç”¨æ‰§è¡Œå™¨` | `é‡ç”¨Statementï¼Œå‡å°‘é¢„ç¼–è¯‘` |
| **BatchExecutor** | `æ‰¹å¤„ç†æ‰§è¡Œå™¨` | `æ‰¹é‡æ“ä½œï¼Œæé«˜æ€§èƒ½` |

**ğŸ” SimpleExecutor (é»˜è®¤)**

```java
// æ¯æ¬¡æ‰§è¡Œéƒ½åˆ›å»ºæ–°çš„Statement
User user1 = mapper.selectById(1);  // åˆ›å»ºStatement1
User user2 = mapper.selectById(2);  // åˆ›å»ºStatement2
User user3 = mapper.selectById(3);  // åˆ›å»ºStatement3
```

**ğŸ” ReuseExecutor (é‡ç”¨)**

```java
// SQLç›¸åŒæ—¶é‡ç”¨Statement
User user1 = mapper.selectById(1);  // åˆ›å»ºStatement
User user2 = mapper.selectById(2);  // é‡ç”¨Statement
User user3 = mapper.selectById(3);  // é‡ç”¨Statement
```

**ğŸ” BatchExecutor (æ‰¹å¤„ç†)**

```java
// æ‰¹é‡æ“ä½œ
SqlSession session = factory.openSession(ExecutorType.BATCH);
UserMapper mapper = session.getMapper(UserMapper.class);

// æ·»åŠ åˆ°æ‰¹å¤„ç†ï¼Œä¸ç«‹å³æ‰§è¡Œ
for (int i = 0; i < 1000; i++) {
    mapper.insert(new User("user" + i, 20));
}

// ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰
session.commit();
```

### 10.3 å¦‚ä½•æŒ‡å®šæ‰§è¡Œå™¨


**æ–¹å¼1ï¼šå…¨å±€é…ç½®**

```xml
<settings>
    <!-- SIMPLE, REUSE, BATCH -->
    <setting name="defaultExecutorType" value="REUSE"/>
</settings>
```

**æ–¹å¼2ï¼šåˆ›å»ºä¼šè¯æ—¶æŒ‡å®š**

```java
// æŒ‡å®šä½¿ç”¨æ‰¹å¤„ç†æ‰§è¡Œå™¨
SqlSession session = factory.openSession(ExecutorType.BATCH);
```

### 10.4 æ‰§è¡Œå™¨ä¸ç¼“å­˜


**ğŸ”¸ ä¸€çº§ç¼“å­˜ (é»˜è®¤å¼€å¯)**

```java
SqlSession session = factory.openSession();
UserMapper mapper = session.getMapper(UserMapper.class);

// ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œæ‰§è¡ŒSQL
User user1 = mapper.selectById(1);

// ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œä»ç¼“å­˜å–ï¼Œä¸æ‰§è¡ŒSQL
User user2 = mapper.selectById(1);

System.out.println(user1 == user2);  // trueï¼ŒåŒä¸€ä¸ªå¯¹è±¡
```

**âš ï¸ ç¼“å­˜å¤±æ•ˆæƒ…å†µ**

```
ç¼“å­˜ä¼šå¤±æ•ˆçš„æƒ…å†µï¼š
â€¢ æ‰§è¡Œäº†å¢åˆ æ”¹æ“ä½œ
â€¢ æ‰‹åŠ¨æ¸…ç©ºç¼“å­˜ï¼šsession.clearCache()
â€¢ å…³é—­äº†SqlSession
â€¢ æŸ¥è¯¢æ¡ä»¶ä¸åŒ
```

**ğŸ’¡ å®é™…åº”ç”¨**

```java
// âœ… æ¨èï¼šåˆ©ç”¨ç¼“å­˜
SqlSession session = factory.openSession();
try {
    UserMapper mapper = session.getMapper(UserMapper.class);
    
    // åªä¼šæ‰§è¡Œä¸€æ¬¡SQL
    User user = mapper.selectById(1);
    // ... ä½¿ç”¨userå¯¹è±¡
    User sameUser = mapper.selectById(1);  // ä»ç¼“å­˜è·å–
    
} finally {
    session.close();
}

// âŒ ä¸æ¨èï¼šé¢‘ç¹åˆ›å»ºsession
User user1 = factory.openSession().getMapper(UserMapper.class).selectById(1);
User user2 = factory.openSession().getMapper(UserMapper.class).selectById(1);
// æ‰§è¡Œä¸¤æ¬¡SQLï¼Œæ²¡ç”¨åˆ°ç¼“å­˜
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹**

```
ğŸ”¸ ORM â†’ Javaå¯¹è±¡å’Œæ•°æ®åº“è¡¨çš„è‡ªåŠ¨è½¬æ¢
ğŸ”¸ SqlSessionFactory â†’ åˆ›å»ºä¼šè¯çš„å·¥å‚(å•ä¾‹)
ğŸ”¸ SqlSession â†’ å’Œæ•°æ®åº“äº¤äº’çš„ä¼šè¯(ç”¨å®Œè¦å…³)
ğŸ”¸ Mapperæ¥å£ â†’ å®šä¹‰æ“ä½œæ–¹æ³•ï¼ŒMyBatisè‡ªåŠ¨å®ç°
ğŸ”¸ é…ç½®æ–‡ä»¶ â†’ mybatis-config.xmlæ€»é…ç½®
ğŸ”¸ æ˜ å°„æ–‡ä»¶ â†’ XxxMapper.xmlå†™SQLçš„åœ°æ–¹
```

### 11.2 ä½¿ç”¨æµç¨‹è®°å¿†


**ğŸ“Š å®Œæ•´ä½¿ç”¨æµç¨‹**

```
â‘  åˆ›å»ºé…ç½®æ–‡ä»¶
   mybatis-config.xml (æ€»é…ç½®)
   XxxMapper.xml (SQLé…ç½®)
   
â‘¡ åˆ›å»ºå·¥å‚
   SqlSessionFactory factory = builder.build(é…ç½®)
   
â‘¢ è·å–ä¼šè¯
   SqlSession session = factory.openSession()
   
â‘£ è·å–Mapper
   XxxMapper mapper = session.getMapper(XxxMapper.class)
   
â‘¤ æ‰§è¡Œæ“ä½œ
   mapper.selectById(1)
   
â‘¥ æäº¤å…³é—­
   session.commit()
   session.close()
```

### 11.3 é‡è¦é…ç½®å¯¹åº”å…³ç³»


**ğŸ”— æ¥å£-é…ç½®-æ•°æ®åº“ ä¸‰è€…å…³ç³»**

| Javaæ¥å£ | **XMLé…ç½®** | **æ•°æ®åº“** |
|---------|-----------|-----------|
| `UserMapperæ¥å£` | `<mapper namespace="UserMapper">` | `userè¡¨` |
| `selectByIdæ–¹æ³•` | `<select id="selectById">` | `SELECTè¯­å¥` |
| `Userè¿”å›ç±»å‹` | `resultType="User"` | `æŸ¥è¯¢ç»“æœ` |
| `int idå‚æ•°` | `#{id}` | `WHEREæ¡ä»¶` |

### 11.4 å¸¸è§é—®é¢˜é€ŸæŸ¥


**â“ å¸¸è§é”™è¯¯åŠè§£å†³**

```
é—®é¢˜1ï¼šæ¥å£æ–¹æ³•æ‰¾ä¸åˆ°å¯¹åº”SQL
â†’ æ£€æŸ¥namespaceæ˜¯å¦æ˜¯æ¥å£å…¨é™å®šå
â†’ æ£€æŸ¥idæ˜¯å¦å’Œæ–¹æ³•åä¸€è‡´

é—®é¢˜2ï¼šå‚æ•°ä¼ ä¸è¿›å»
â†’ å•ä¸ªå‚æ•°ç›´æ¥ç”¨#{ä»»æ„å}
â†’ å¤šä¸ªå‚æ•°ç”¨@Paramæˆ–#{param1}

é—®é¢˜3ï¼šç»“æœæ˜ å°„ä¸ä¸Š
â†’ å¼€å¯é©¼å³°å‘½åè½¬æ¢
â†’ æˆ–ä½¿ç”¨resultMapæ‰‹åŠ¨æ˜ å°„

é—®é¢˜4ï¼šä¼šè¯å…³é—­æŠ¥é”™
â†’ ä½¿ç”¨try-with-resourcesè‡ªåŠ¨å…³é—­
â†’ æˆ–åœ¨finallyä¸­ç¡®ä¿close()

é—®é¢˜5ï¼šäº‹åŠ¡ä¸ç”Ÿæ•ˆ
â†’ æ£€æŸ¥æ˜¯å¦è°ƒç”¨commit()
â†’ æ£€æŸ¥æ˜¯å¦è®¾ç½®è‡ªåŠ¨æäº¤
```

### 11.5 å­¦ä¹ å»ºè®®


**ğŸ“ å¾ªåºæ¸è¿›å­¦ä¹ è·¯å¾„**

```
ç¬¬1æ­¥ï¼šç†è§£ORMæ¦‚å¿µ
     â†“
ç¬¬2æ­¥ï¼šæŒæ¡åŸºæœ¬é…ç½®
     â†“  
ç¬¬3æ­¥ï¼šå­¦ä¼šCRUDæ“ä½œ
     â†“
ç¬¬4æ­¥ï¼šç†è§£åŠ¨æ€SQL
     â†“
ç¬¬5æ­¥ï¼šæŒæ¡é«˜çº§ç‰¹æ€§
```

**ğŸ’¡ å®è·µè¦ç‚¹**

```
âœ… å¤šå†™ä»£ç ï¼šå…‰çœ‹ä¸ç»ƒå‡æŠŠå¼
âœ… å¯¹ç…§æ–‡æ¡£ï¼šé‡åˆ°é—®é¢˜æŸ¥å®˜æ–¹æ–‡æ¡£
âœ… ç†è§£åŸç†ï¼šçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶
âœ… ç§¯ç´¯ç»éªŒï¼šè®°å½•å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
```

**ğŸ”‘ è®°å¿†å£è¯€**

```
MyBatisçœŸç®€å•ï¼Œ
å·¥å‚ä¼šè¯æ˜¯å…³é”®ï¼Œ
æ¥å£ä»£ç†è‡ªåŠ¨åšï¼Œ
é…ç½®æ˜ å°„è¦å¯¹åº”ï¼Œ
SQLè‡ªå·±å†™ï¼Œç»“æœè‡ªåŠ¨è½¬ï¼Œ
æäº¤å…³é—­åˆ«å¿˜è®°ï¼
```