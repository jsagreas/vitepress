---
title: 4ã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½å¤„ç†
---
## ğŸ“š ç›®å½•


1. [æ–‡ä»¶å¤„ç†åŸºç¡€æ¦‚å¿µ](#1-æ–‡ä»¶å¤„ç†åŸºç¡€æ¦‚å¿µ)
2. [æ–‡ä»¶ä¸Šä¼ é…ç½®](#2-æ–‡ä»¶ä¸Šä¼ é…ç½®)
3. [æ–‡ä»¶ä¸Šä¼ å®ç°](#3-æ–‡ä»¶ä¸Šä¼ å®ç°)
4. [æ–‡ä»¶ä¸‹è½½å®ç°](#4-æ–‡ä»¶ä¸‹è½½å®ç°)
5. [æ–‡ä»¶å®‰å…¨å¤„ç†](#5-æ–‡ä»¶å®‰å…¨å¤„ç†)
6. [é«˜çº§åŠŸèƒ½å®ç°](#6-é«˜çº§åŠŸèƒ½å®ç°)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦æŒæ¡SpringMVCåŸºç¡€ã€HTTPåè®® â†’ **å½“å‰å†…å®¹**ï¼šæ–‡ä»¶ä¸Šä¼ ä¸‹è½½ â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ å¯¹è±¡å­˜å‚¨(OSS)

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡50åˆ†é’Ÿ | å®è·µç»ƒä¹ 40åˆ†é’Ÿ

**ğŸ¯ æœ¬èŠ‚é‡ç‚¹**
- [ ] ç†è§£MultipartResolverçš„ä½œç”¨
- [ ] æŒæ¡æ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´æµç¨‹
- [ ] å­¦ä¼šæ–‡ä»¶ç±»å‹å’Œå¤§å°çš„æ ¡éªŒ
- [ ] äº†è§£æ–‡ä»¶å­˜å‚¨çš„ä¸åŒç­–ç•¥

---

## 1. ğŸ“¦ æ–‡ä»¶å¤„ç†åŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ ä¸‹è½½



**ğŸ’¡ ç”Ÿæ´»åŒ–ç†è§£**
```
æƒ³è±¡ä½ ç”¨å¾®ä¿¡å‘ç…§ç‰‡ï¼š
- æ–‡ä»¶ä¸Šä¼ ï¼šæŠŠæ‰‹æœºé‡Œçš„ç…§ç‰‡å‘ç»™æœ‹å‹ï¼ˆå®¢æˆ·ç«¯â†’æœåŠ¡å™¨ï¼‰
- æ–‡ä»¶ä¸‹è½½ï¼šä¿å­˜æœ‹å‹å‘æ¥çš„ç…§ç‰‡ï¼ˆæœåŠ¡å™¨â†’å®¢æˆ·ç«¯ï¼‰

åœ¨Webåº”ç”¨ä¸­ï¼š
- ä¸Šä¼ ï¼šç”¨æˆ·é€‰æ‹©æ–‡ä»¶ï¼Œæäº¤ç»™æœåŠ¡å™¨ä¿å­˜
- ä¸‹è½½ï¼šæœåŠ¡å™¨æŠŠæ–‡ä»¶å‘é€ç»™ç”¨æˆ·æµè§ˆå™¨
```

### 1.2 æ–‡ä»¶ä¸Šä¼ çš„æŠ€æœ¯åŸç†



**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**

**HTTPè¡¨å•ç¼–ç æ–¹å¼**ï¼š
- **æ™®é€šè¡¨å•**ï¼š`application/x-www-form-urlencoded` - åªèƒ½ä¼ æ–‡æœ¬
- **æ–‡ä»¶è¡¨å•**ï¼š`multipart/form-data` - å¯ä»¥ä¼ æ–‡ä»¶å’Œæ–‡æœ¬

**å·¥ä½œæµç¨‹**ï¼š
```
ç”¨æˆ·æ“ä½œ              æµè§ˆå™¨å¤„ç†              æœåŠ¡å™¨å¤„ç†
   |                     |                      |
é€‰æ‹©æ–‡ä»¶ â”€â”€â”€â”€â”€â”€â†’ è¯»å–æ–‡ä»¶å†…å®¹ â”€â”€â”€â”€â”€â”€â†’ æ¥æ”¶æ–‡ä»¶æ•°æ®
   |                     |                      |
ç‚¹å‡»ä¸Šä¼  â”€â”€â”€â”€â”€â”€â†’ åˆ†å—ä¼ è¾“æ•°æ® â”€â”€â”€â”€â”€â”€â†’ éªŒè¯å’Œä¿å­˜
   |                     |                      |
ç­‰å¾…ç»“æœ â†â”€â”€â”€â”€â”€â”€ æ˜¾ç¤ºè¿›åº¦æ¡ â†â”€â”€â”€â”€â”€â”€ è¿”å›å¤„ç†ç»“æœ
```

### 1.3 å¸¸è§æ–‡ä»¶æ“ä½œåœºæ™¯



| **åº”ç”¨åœºæ™¯** | **æ–‡ä»¶ç±»å‹** | **æŠ€æœ¯è¦ç‚¹** |
|-------------|------------|-------------|
| ğŸ“· **å¤´åƒä¸Šä¼ ** | å›¾ç‰‡(jpg/png) | å›¾ç‰‡å‹ç¼©ã€å°ºå¯¸é™åˆ¶ |
| ğŸ“„ **æ–‡æ¡£ç®¡ç†** | PDF/Word/Excel | æ–‡ä»¶é¢„è§ˆã€æ ¼å¼è½¬æ¢ |
| ğŸ“¹ **è§†é¢‘ä¸Šä¼ ** | MP4/AVI | åˆ†ç‰‡ä¸Šä¼ ã€è½¬ç å¤„ç† |
| ğŸ“¦ **æ–‡ä»¶åˆ†äº«** | ä»»æ„ç±»å‹ | æƒé™æ§åˆ¶ã€é˜²ç›—é“¾ |

---

## 2. âš™ï¸ æ–‡ä»¶ä¸Šä¼ é…ç½®



### 2.1 MultipartResolveré…ç½®



**ğŸ”¸ ä»€ä¹ˆæ˜¯MultipartResolver**
> è¿™æ˜¯Springæä¾›çš„"æ–‡ä»¶å¤„ç†å™¨"ï¼Œä¸“é—¨è´Ÿè´£è§£æä¸Šä¼ çš„æ–‡ä»¶æ•°æ®

**Springé…ç½®æ–¹å¼**ï¼š

```java
@Configuration
public class FileUploadConfig {
    
    /**
     * é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨
     * ä½œç”¨ï¼šå‘Šè¯‰Springå¦‚ä½•å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
     */
    @Bean
    public MultipartResolver multipartResolver() {
        CommonsMultipartResolver resolver = new CommonsMultipartResolver();
        
        // è®¾ç½®æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼š10MB
        resolver.setMaxUploadSize(10 * 1024 * 1024);
        
        // è®¾ç½®å•ä¸ªæ–‡ä»¶æœ€å¤§ï¼š5MB
        resolver.setMaxUploadSizePerFile(5 * 1024 * 1024);
        
        // è®¾ç½®ç¼–ç æ ¼å¼ï¼šé˜²æ­¢æ–‡ä»¶åä¹±ç 
        resolver.setDefaultEncoding("UTF-8");
        
        return resolver;
    }
}
```

**ğŸ“ é…ç½®å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹å€¼ |
|------|------|--------|
| `maxUploadSize` | ä¸€æ¬¡è¯·æ±‚æ‰€æœ‰æ–‡ä»¶æ€»å¤§å° | 10MB |
| `maxUploadSizePerFile` | å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å° | 5MB |
| `defaultEncoding` | æ–‡ä»¶åç¼–ç æ ¼å¼ | UTF-8 |

### 2.2 application.ymlé…ç½®



**SpringBooté…ç½®æ–¹å¼**ï¼š

```yaml
spring:
  servlet:
    multipart:
      enabled: true                    # å¯ç”¨æ–‡ä»¶ä¸Šä¼ 
      max-file-size: 5MB              # å•ä¸ªæ–‡ä»¶æœ€å¤§5MB
      max-request-size: 10MB          # æ€»è¯·æ±‚æœ€å¤§10MB
      file-size-threshold: 2KB        # è¶…è¿‡2KBå†™å…¥ç£ç›˜
      location: /tmp                  # ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ä½ç½®
```

**ğŸ’¡ å‚æ•°ç†è§£**ï¼š
- `file-size-threshold`: å°æ–‡ä»¶ç›´æ¥åœ¨å†…å­˜å¤„ç†ï¼Œå¤§æ–‡ä»¶å…ˆå­˜ä¸´æ—¶ç›®å½•
- `location`: ä¸´æ—¶æ–‡ä»¶ä½ç½®ï¼Œå¤„ç†å®Œä¼šè‡ªåŠ¨åˆ é™¤

### 2.3 å¿…éœ€ä¾èµ–



```xml
<!-- æ–‡ä»¶ä¸Šä¼ æ ¸å¿ƒä¾èµ– -->
<dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.4</version>
</dependency>

<!-- æ–‡ä»¶å¤„ç†å·¥å…· -->
<dependency>
    <groupId>commons-io</groupId>
    <artifactId>commons-io</artifactId>
    <version>2.11.0</version>
</dependency>
```

---

## 3. ğŸ“¤ æ–‡ä»¶ä¸Šä¼ å®ç°



### 3.1 å‰ç«¯è¡¨å•è®¾è®¡



**HTMLè¡¨å•è¦ç‚¹**ï¼š

```html
<!-- é‡ç‚¹1ï¼šå¿…é¡»è®¾ç½® enctype="multipart/form-data" -->
<form action="/upload" method="post" enctype="multipart/form-data">
    
    <!-- é‡ç‚¹2ï¼šä½¿ç”¨ type="file" çš„input -->
    <input type="file" name="file" accept="image/*">
    
    <!-- å¯é€‰ï¼šé™åˆ¶æ–‡ä»¶ç±»å‹ -->
    <!-- accept="image/*" åªæ¥å—å›¾ç‰‡ -->
    <!-- accept=".pdf,.doc" åªæ¥å—PDFå’ŒWord -->
    
    <button type="submit">ä¸Šä¼ æ–‡ä»¶</button>
</form>
```

**âš ï¸ å¸¸è§é”™è¯¯**ï¼š
> âŒ å¿˜è®°è®¾ç½®`enctype`å¯¼è‡´æ–‡ä»¶ä¼ ä¸è¿‡æ¥
> âŒ `name`å±æ€§å’Œåç«¯æ¥æ”¶å‚æ•°åä¸ä¸€è‡´

### 3.2 åç«¯æ¥æ”¶æ–‡ä»¶



**åŸºç¡€å•æ–‡ä»¶ä¸Šä¼ **ï¼š

```java
@RestController
@RequestMapping("/file")
public class FileController {
    
    /**
     * å•æ–‡ä»¶ä¸Šä¼ 
     * @param file å‰ç«¯ä¼ æ¥çš„æ–‡ä»¶ï¼Œå‚æ•°åå¿…é¡»å’Œè¡¨å•nameä¸€è‡´
     */
    @PostMapping("/upload")
    public String uploadFile(@RequestParam("file") MultipartFile file) {
        
        // 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
        if (file.isEmpty()) {
            return "è¯·é€‰æ‹©æ–‡ä»¶";
        }
        
        // 2. è·å–æ–‡ä»¶ä¿¡æ¯
        String fileName = file.getOriginalFilename();  // åŸå§‹æ–‡ä»¶å
        long fileSize = file.getSize();                // æ–‡ä»¶å¤§å°(å­—èŠ‚)
        String contentType = file.getContentType();    // æ–‡ä»¶ç±»å‹
        
        // 3. ä¿å­˜æ–‡ä»¶
        try {
            // æŒ‡å®šä¿å­˜è·¯å¾„
            String savePath = "D:/uploads/" + fileName;
            file.transferTo(new File(savePath));
            
            return "ä¸Šä¼ æˆåŠŸï¼š" + fileName;
        } catch (IOException e) {
            return "ä¸Šä¼ å¤±è´¥ï¼š" + e.getMessage();
        }
    }
}
```

**å¤šæ–‡ä»¶ä¸Šä¼ **ï¼š

```java
@PostMapping("/batch-upload")
public String uploadFiles(@RequestParam("files") MultipartFile[] files) {
    
    if (files == null || files.length == 0) {
        return "è¯·é€‰æ‹©æ–‡ä»¶";
    }
    
    int successCount = 0;
    
    // éå†å¤„ç†æ¯ä¸ªæ–‡ä»¶
    for (MultipartFile file : files) {
        if (!file.isEmpty()) {
            try {
                String fileName = file.getOriginalFilename();
                file.transferTo(new File("D:/uploads/" + fileName));
                successCount++;
            } catch (IOException e) {
                // è®°å½•å¤±è´¥çš„æ–‡ä»¶
                System.err.println("æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š" + file.getOriginalFilename());
            }
        }
    }
    
    return String.format("æˆåŠŸä¸Šä¼  %d ä¸ªæ–‡ä»¶", successCount);
}
```

### 3.3 æ–‡ä»¶ç±»å‹æ ¡éªŒ



**å®ç°æ–‡ä»¶ç±»å‹æ£€æŸ¥**ï¼š

```java
/**
 * æ ¡éªŒæ–‡ä»¶ç±»å‹
 */
private boolean isValidFileType(MultipartFile file) {
    String fileName = file.getOriginalFilename();
    
    // å…è®¸çš„æ–‡ä»¶æ‰©å±•å
    String[] allowedExtensions = {".jpg", ".png", ".jpeg", ".gif", ".pdf"};
    
    // æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
    for (String ext : allowedExtensions) {
        if (fileName.toLowerCase().endsWith(ext)) {
            return true;
        }
    }
    
    return false;
}

/**
 * ä½¿ç”¨æ ¡éªŒ
 */
@PostMapping("/upload-with-check")
public String uploadWithCheck(@RequestParam("file") MultipartFile file) {
    
    // ç±»å‹æ£€æŸ¥
    if (!isValidFileType(file)) {
        return "ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œä»…æ”¯æŒï¼šjpg/png/pdf";
    }
    
    // å¤§å°æ£€æŸ¥
    if (file.getSize() > 5 * 1024 * 1024) {
        return "æ–‡ä»¶è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ5MB";
    }
    
    // ä¿å­˜æ–‡ä»¶...
    return "ä¸Šä¼ æˆåŠŸ";
}
```

---

## 4. ğŸ“¥ æ–‡ä»¶ä¸‹è½½å®ç°



### 4.1 åŸºç¡€æ–‡ä»¶ä¸‹è½½



**æ ¸å¿ƒåŸç†**ï¼š
```
æœåŠ¡å™¨å‡†å¤‡æ–‡ä»¶ â†’ è®¾ç½®å“åº”å¤´ â†’ å†™å…¥æ–‡ä»¶æµ â†’ æµè§ˆå™¨æ¥æ”¶
```

**å®ç°ä»£ç **ï¼š

```java
@GetMapping("/download")
public void downloadFile(HttpServletResponse response) throws IOException {
    
    // 1. å‡†å¤‡è¦ä¸‹è½½çš„æ–‡ä»¶
    String filePath = "D:/uploads/example.pdf";
    File file = new File(filePath);
    
    // 2. è®¾ç½®å“åº”å¤´ï¼Œå‘Šè¯‰æµè§ˆå™¨è¿™æ˜¯è¦ä¸‹è½½çš„æ–‡ä»¶
    response.setContentType("application/octet-stream");
    response.setHeader("Content-Disposition", 
                      "attachment; filename=" + file.getName());
    
    // 3. è¯»å–æ–‡ä»¶å¹¶å†™å…¥å“åº”æµ
    try (FileInputStream fis = new FileInputStream(file);
         ServletOutputStream os = response.getOutputStream()) {
        
        byte[] buffer = new byte[1024];
        int len;
        while ((len = fis.read(buffer)) != -1) {
            os.write(buffer, 0, len);
        }
        os.flush();
    }
}
```

**ğŸ’¡ å“åº”å¤´è¯´æ˜**ï¼š
- `Content-Type`: å‘Šè¯‰æµè§ˆå™¨æ–‡ä»¶ç±»å‹
- `Content-Disposition`: `attachment`è¡¨ç¤ºä¸‹è½½ï¼Œ`inline`è¡¨ç¤ºé¢„è§ˆ

### 4.2 æ–‡ä»¶åä¹±ç å¤„ç†



**ä¸­æ–‡æ–‡ä»¶åå¤„ç†**ï¼š

```java
@GetMapping("/download/{fileName}")
public void download(@PathVariable String fileName, 
                    HttpServletResponse response) throws IOException {
    
    // è§£å†³ä¸­æ–‡æ–‡ä»¶åä¹±ç 
    String encodedFileName = URLEncoder.encode(fileName, "UTF-8");
    
    // å…¼å®¹ä¸åŒæµè§ˆå™¨
    response.setHeader("Content-Disposition", 
        "attachment; filename=\"" + encodedFileName + "\"; " +
        "filename*=UTF-8''" + encodedFileName);
    
    // æ–‡ä»¶ä¼ è¾“...
}
```

### 4.3 æ–‡ä»¶é¢„è§ˆåŠŸèƒ½



**åœ¨çº¿é¢„è§ˆå®ç°**ï¼š

```java
/**
 * å›¾ç‰‡é¢„è§ˆ
 */
@GetMapping("/preview/image/{fileName}")
public void previewImage(@PathVariable String fileName,
                        HttpServletResponse response) throws IOException {
    
    File file = new File("D:/uploads/" + fileName);
    
    // è®¾ç½®ä¸ºinlineï¼Œæµè§ˆå™¨ç›´æ¥æ˜¾ç¤º
    response.setContentType("image/jpeg");
    response.setHeader("Content-Disposition", "inline");
    
    // è¾“å‡ºå›¾ç‰‡
    Files.copy(file.toPath(), response.getOutputStream());
}

/**
 * PDFé¢„è§ˆ
 */
@GetMapping("/preview/pdf/{fileName}")
public void previewPdf(@PathVariable String fileName,
                      HttpServletResponse response) throws IOException {
    
    File file = new File("D:/uploads/" + fileName);
    
    response.setContentType("application/pdf");
    response.setHeader("Content-Disposition", "inline");
    
    Files.copy(file.toPath(), response.getOutputStream());
}
```

---

## 5. ğŸ”’ æ–‡ä»¶å®‰å…¨å¤„ç†



### 5.1 æ–‡ä»¶å®‰å…¨æ£€æŸ¥



**å®‰å…¨æ£€æŸ¥è¦ç‚¹**ï¼š

```java
public class FileSecurityChecker {
    
    /**
     * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å®‰å…¨
     */
    public static boolean isFileSafe(MultipartFile file) {
        
        // 1. æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé˜²æ­¢è¶…å¤§æ–‡ä»¶æ”»å‡»ï¼‰
        if (file.getSize() > 10 * 1024 * 1024) {
            return false;
        }
        
        // 2. æ£€æŸ¥æ–‡ä»¶ç±»å‹ï¼ˆé˜²æ­¢ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶ï¼‰
        String fileName = file.getOriginalFilename();
        String[] dangerousExt = {".exe", ".bat", ".sh", ".php", ".jsp"};
        
        for (String ext : dangerousExt) {
            if (fileName.toLowerCase().endsWith(ext)) {
                return false;
            }
        }
        
        // 3. æ£€æŸ¥çœŸå®æ–‡ä»¶ç±»å‹ï¼ˆé˜²æ­¢ä¼ªè£…æ–‡ä»¶ï¼‰
        try {
            String realType = Files.probeContentType(
                new File(fileName).toPath()
            );
            // è¿›ä¸€æ­¥éªŒè¯...
        } catch (IOException e) {
            return false;
        }
        
        return true;
    }
}
```

### 5.2 æ–‡ä»¶å­˜å‚¨ç­–ç•¥



**ğŸ“ å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| å­˜å‚¨æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|---------|
| **æœ¬åœ°ç£ç›˜** | ç®€å•å¿«é€Ÿ | å•æœºå­˜å‚¨é™åˆ¶ | å°å‹åº”ç”¨ |
| **æ•°æ®åº“** | äº‹åŠ¡ä¸€è‡´æ€§ | æ€§èƒ½å·®ã€å ç©ºé—´ | å°æ–‡ä»¶ã€éœ€è¦äº‹åŠ¡ |
| **å¯¹è±¡å­˜å‚¨(OSS)** | æµ·é‡å­˜å‚¨ã€CDNåŠ é€Ÿ | éœ€è¦ä»˜è´¹ | ç”Ÿäº§ç¯å¢ƒæ¨è |

**æœ¬åœ°å­˜å‚¨ä¼˜åŒ–**ï¼š

```java
/**
 * æŒ‰æ—¥æœŸåˆ†ç›®å½•å­˜å‚¨
 */
public String saveFileByDate(MultipartFile file) throws IOException {
    
    // 1. æŒ‰æ—¥æœŸåˆ›å»ºç›®å½•ï¼šuploads/2025/09/23/
    String datePath = LocalDate.now().format(
        DateTimeFormatter.ofPattern("yyyy/MM/dd")
    );
    String uploadDir = "D:/uploads/" + datePath;
    
    File dir = new File(uploadDir);
    if (!dir.exists()) {
        dir.mkdirs();
    }
    
    // 2. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆé˜²æ­¢é‡åè¦†ç›–ï¼‰
    String originalName = file.getOriginalFilename();
    String extension = originalName.substring(originalName.lastIndexOf("."));
    String uniqueName = UUID.randomUUID().toString() + extension;
    
    // 3. ä¿å­˜æ–‡ä»¶
    String savePath = uploadDir + "/" + uniqueName;
    file.transferTo(new File(savePath));
    
    // 4. è¿”å›æ–‡ä»¶è®¿é—®è·¯å¾„
    return datePath + "/" + uniqueName;
}
```

### 5.3 é˜²ç›—é“¾å¤„ç†



**Refereræ£€æŸ¥**ï¼š

```java
@GetMapping("/secure-download/{fileName}")
public void secureDownload(@PathVariable String fileName,
                          HttpServletRequest request,
                          HttpServletResponse response) throws IOException {
    
    // æ£€æŸ¥æ¥æº
    String referer = request.getHeader("Referer");
    if (referer == null || !referer.contains("yourdomain.com")) {
        response.sendError(HttpServletResponse.SC_FORBIDDEN, "ç¦æ­¢ç›—é“¾");
        return;
    }
    
    // æ­£å¸¸ä¸‹è½½æµç¨‹...
}
```

---

## 6. ğŸš€ é«˜çº§åŠŸèƒ½å®ç°



### 6.1 å›¾ç‰‡å‹ç¼©å¤„ç†



**ä½¿ç”¨Thumbnailatoråº“**ï¼š

```java
/**
 * å›¾ç‰‡å‹ç¼©ä¸Šä¼ 
 */
@PostMapping("/upload-image")
public String uploadImage(@RequestParam("file") MultipartFile file) 
    throws IOException {
    
    // 1. ä¿å­˜åŸå›¾
    String originalPath = saveFile(file);
    
    // 2. ç”Ÿæˆç¼©ç•¥å›¾
    String thumbnailPath = originalPath.replace(".jpg", "_thumb.jpg");
    
    Thumbnails.of(originalPath)
        .size(200, 200)           // å°ºå¯¸200x200
        .outputQuality(0.8)       // è´¨é‡80%
        .toFile(thumbnailPath);   // ä¿å­˜ç¼©ç•¥å›¾
    
    return "ä¸Šä¼ æˆåŠŸï¼Œå·²ç”Ÿæˆç¼©ç•¥å›¾";
}
```

**ä¾èµ–é…ç½®**ï¼š
```xml
<dependency>
    <groupId>net.coobird</groupId>
    <artifactId>thumbnailator</artifactId>
    <version>0.4.19</version>
</dependency>
```

### 6.2 æ‰¹é‡æ–‡ä»¶å¤„ç†



**ZIPæ‰“åŒ…ä¸‹è½½**ï¼š

```java
@GetMapping("/download-batch")
public void downloadBatch(HttpServletResponse response) throws IOException {
    
    // è®¾ç½®å“åº”å¤´
    response.setContentType("application/zip");
    response.setHeader("Content-Disposition", 
                      "attachment; filename=files.zip");
    
    // åˆ›å»ºZIPè¾“å‡ºæµ
    try (ZipOutputStream zos = new ZipOutputStream(
            response.getOutputStream())) {
        
        // è¦æ‰“åŒ…çš„æ–‡ä»¶åˆ—è¡¨
        String[] files = {"file1.pdf", "file2.jpg", "file3.doc"};
        
        for (String fileName : files) {
            File file = new File("D:/uploads/" + fileName);
            
            // æ·»åŠ åˆ°ZIP
            ZipEntry entry = new ZipEntry(fileName);
            zos.putNextEntry(entry);
            
            Files.copy(file.toPath(), zos);
            zos.closeEntry();
        }
    }
}
```

### 6.3 å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 



**åˆ†ç‰‡ä¸Šä¼ æµç¨‹**ï¼š

```
å¤§æ–‡ä»¶(100MB) â†’ åˆ‡åˆ†æˆå°å—(æ¯å—5MB) â†’ 
åˆ†åˆ«ä¸Šä¼  â†’ æœåŠ¡å™¨åˆå¹¶ â†’ å®Œæ•´æ–‡ä»¶
```

**åç«¯åˆå¹¶å®ç°**ï¼š

```java
@PostMapping("/merge-chunks")
public String mergeChunks(@RequestParam String fileName,
                         @RequestParam int totalChunks) throws IOException {
    
    String finalPath = "D:/uploads/" + fileName;
    
    try (FileOutputStream fos = new FileOutputStream(finalPath)) {
        
        // æŒ‰é¡ºåºåˆå¹¶åˆ†ç‰‡
        for (int i = 0; i < totalChunks; i++) {
            String chunkPath = "D:/uploads/chunks/" + fileName + "_" + i;
            File chunkFile = new File(chunkPath);
            
            Files.copy(chunkFile.toPath(), fos);
            
            // åˆ é™¤åˆ†ç‰‡æ–‡ä»¶
            chunkFile.delete();
        }
    }
    
    return "æ–‡ä»¶åˆå¹¶æˆåŠŸ";
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ MultipartResolverï¼šSpringçš„æ–‡ä»¶è§£æå™¨ï¼Œè´Ÿè´£å¤„ç†ä¸Šä¼ æ–‡ä»¶
ğŸ”¸ multipart/form-dataï¼šæ–‡ä»¶ä¸Šä¼ å¿…é¡»ä½¿ç”¨çš„è¡¨å•ç¼–ç ç±»å‹
ğŸ”¸ æ–‡ä»¶å®‰å…¨ï¼šæ£€æŸ¥ç±»å‹ã€å¤§å°ã€çœŸå®æ ¼å¼ï¼Œé˜²æ­¢æ¶æ„æ–‡ä»¶
ğŸ”¸ å­˜å‚¨ç­–ç•¥ï¼šæœ¬åœ°å­˜å‚¨é€‚åˆå°é¡¹ç›®ï¼Œå¯¹è±¡å­˜å‚¨é€‚åˆç”Ÿäº§ç¯å¢ƒ
ğŸ”¸ å“åº”å¤´è®¾ç½®ï¼šContent-Dispositionå†³å®šä¸‹è½½è¿˜æ˜¯é¢„è§ˆ
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¸ºä»€ä¹ˆè¦è®¾ç½®enctype**
```
æ™®é€šè¡¨å•ç¼–ç ï¼š
- åªèƒ½ä¼ æ–‡æœ¬ï¼Œæ ¼å¼ï¼škey1=value1&key2=value2
- æ— æ³•ä¼ è¾“äºŒè¿›åˆ¶æ–‡ä»¶æ•°æ®

multipart/form-dataç¼–ç ï¼š
- å¯ä»¥ä¼ æ–‡æœ¬å’Œæ–‡ä»¶
- å°†æ•°æ®åˆ†æˆå¤šä¸ªéƒ¨åˆ†(part)ä¼ è¾“
- æ¯éƒ¨åˆ†æœ‰ç‹¬ç«‹çš„å¤´ä¿¡æ¯
```

**ğŸ”¹ æ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´æµç¨‹**
```
1. å‰ç«¯é€‰æ‹©æ–‡ä»¶ï¼Œè¡¨å•æäº¤
2. æµè§ˆå™¨å°†æ–‡ä»¶ç¼–ç ä¸ºmultipartæ ¼å¼
3. æœåŠ¡å™¨MultipartResolverè§£æ
4. ç”ŸæˆMultipartFileå¯¹è±¡
5. ä¸šåŠ¡ä»£ç ä¿å­˜æ–‡ä»¶
6. è¿”å›ç»“æœç»™å‰ç«¯
```

**ğŸ”¹ å¸¸è§é—®é¢˜è§£å†³**

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| æ–‡ä»¶ä¼ ä¸è¿‡æ¥ | æœªè®¾ç½®enctype | åŠ ä¸Š`enctype="multipart/form-data"` |
| ä¸­æ–‡æ–‡ä»¶åä¹±ç  | ç¼–ç ä¸ä¸€è‡´ | ä½¿ç”¨URLEncoderç¼–ç  |
| æ–‡ä»¶è¿‡å¤§æŠ¥é”™ | è¶…è¿‡é™åˆ¶ | è°ƒæ•´maxUploadSizeé…ç½® |
| ä¸Šä¼ åæ‰¾ä¸åˆ°æ–‡ä»¶ | è·¯å¾„é”™è¯¯ | æ£€æŸ¥ä¿å­˜è·¯å¾„æ˜¯å¦å­˜åœ¨ |

### 7.3 å®é™…åº”ç”¨å»ºè®®



**ğŸ¯ å¼€å‘å®è·µ**
```
åŸºç¡€åŠŸèƒ½ï¼š
- å•æ–‡ä»¶ä¸Šä¼ ï¼šå¤´åƒã€è¯ä»¶ç…§
- æ‰¹é‡ä¸Šä¼ ï¼šç›¸å†Œã€æ–‡æ¡£ç®¡ç†
- æ–‡ä»¶ä¸‹è½½ï¼šæŠ¥è¡¨å¯¼å‡ºã€èµ„æ–™ä¸‹è½½

è¿›é˜¶åŠŸèƒ½ï¼š
- å›¾ç‰‡å‹ç¼©ï¼šå‡å°‘å­˜å‚¨å’Œå¸¦å®½
- å¤§æ–‡ä»¶åˆ†ç‰‡ï¼šè§†é¢‘ä¸Šä¼ 
- æ–‡ä»¶é¢„è§ˆï¼šPDFã€å›¾ç‰‡åœ¨çº¿æŸ¥çœ‹
```

**ğŸ›¡ï¸ å®‰å…¨å»ºè®®**
```
å¿…é¡»åšçš„ï¼š
âœ… é™åˆ¶æ–‡ä»¶ç±»å‹å’Œå¤§å°
âœ… æ£€æŸ¥æ–‡ä»¶çœŸå®ç±»å‹
âœ… ç¦æ­¢ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶
âœ… æ–‡ä»¶åä½¿ç”¨UUIDé˜²é‡å¤

æ¨èåšçš„ï¼š
ğŸ’¡ ä½¿ç”¨å¯¹è±¡å­˜å‚¨(OSS)
ğŸ’¡ æ·»åŠ é˜²ç›—é“¾æœºåˆ¶
ğŸ’¡ æ–‡ä»¶ç—…æ¯’æ‰«æ
ğŸ’¡ è®°å½•ä¸Šä¼ æ—¥å¿—
```

### 7.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



- [ ] èƒ½é…ç½®MultipartResolver
- [ ] ä¼šå†™æ–‡ä»¶ä¸Šä¼ çš„å‰åç«¯ä»£ç 
- [ ] ç†è§£æ–‡ä»¶ç±»å‹å’Œå¤§å°æ ¡éªŒ
- [ ] æŒæ¡æ–‡ä»¶ä¸‹è½½å’Œé¢„è§ˆ
- [ ] äº†è§£æ–‡ä»¶å®‰å…¨çš„é‡è¦æ€§
- [ ] çŸ¥é“ä¸åŒå­˜å‚¨ç­–ç•¥çš„é€‰æ‹©

**ğŸ”‘ æ ¸å¿ƒè®°å¿†**
> æ–‡ä»¶ä¸Šä¼ è¦è®¾ç½®multipartç¼–ç 
> MultipartResolverè´Ÿè´£è§£ææ–‡ä»¶
> å®‰å…¨æ£€æŸ¥ç±»å‹å¤§å°å¾ˆé‡è¦
> å­˜å‚¨ç­–ç•¥æŒ‰éœ€é€‰æ‹©æœ€åˆé€‚

**ğŸ’¡ å»¶ä¼¸å­¦ä¹ **
- ğŸ“– å­¦ä¹ é˜¿é‡Œäº‘OSSã€è…¾è®¯äº‘COSç­‰å¯¹è±¡å­˜å‚¨
- ğŸ“– äº†è§£FastDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ
- ğŸ“– ç ”ç©¶WebSocketå®ç°å®æ—¶ä¸Šä¼ è¿›åº¦