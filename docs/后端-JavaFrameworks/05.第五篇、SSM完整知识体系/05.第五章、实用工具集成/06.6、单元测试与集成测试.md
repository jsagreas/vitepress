---
title: 6ã€å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•
---
## ğŸ“š ç›®å½•

1. [æµ‹è¯•åŸºç¡€æ¦‚å¿µ](#1-æµ‹è¯•åŸºç¡€æ¦‚å¿µ)
2. [JUnit5æµ‹è¯•æ¡†æ¶](#2-JUnit5æµ‹è¯•æ¡†æ¶)
3. [Spring Testæµ‹è¯•æ”¯æŒ](#3-Spring-Testæµ‹è¯•æ”¯æŒ)
4. [Webå±‚æµ‹è¯•](#4-Webå±‚æµ‹è¯•)
5. [æ•°æ®å±‚æµ‹è¯•](#5-æ•°æ®å±‚æµ‹è¯•)
6. [æ¨¡æ‹Ÿæµ‹è¯•æŠ€æœ¯](#6-æ¨¡æ‹Ÿæµ‹è¯•æŠ€æœ¯)
7. [æµ‹è¯•æ•°æ®ç®¡ç†](#7-æµ‹è¯•æ•°æ®ç®¡ç†)
8. [æµ‹è¯•æœ€ä½³å®è·µ](#8-æµ‹è¯•æœ€ä½³å®è·µ)

---

## 1. ğŸ¯ æµ‹è¯•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è½¯ä»¶æµ‹è¯•


**ğŸ”¸ é€šä¿—ç†è§£**
```
æƒ³è±¡ä½ åšäº†ä¸€é“èœï¼š
- å°ä¸€å£å‘³é“ â†’ å•å…ƒæµ‹è¯•ï¼ˆæµ‹è¯•æŸä¸ªåŠŸèƒ½ï¼‰
- çœ‹æ•´ä½“è‰²é¦™å‘³ â†’ é›†æˆæµ‹è¯•ï¼ˆæµ‹è¯•åŠŸèƒ½é…åˆï¼‰
- è¯·å®¢äººå“å° â†’ ç³»ç»Ÿæµ‹è¯•ï¼ˆçœŸå®ç¯å¢ƒæµ‹è¯•ï¼‰

è½¯ä»¶æµ‹è¯•å°±æ˜¯ç¡®ä¿ç¨‹åºèƒ½æ­£ç¡®å·¥ä½œï¼
```

**æ ¸å¿ƒæ¦‚å¿µ**
- **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•æœ€å°çš„ä»£ç å•å…ƒï¼ˆä¸€ä¸ªæ–¹æ³•ã€ä¸€ä¸ªç±»ï¼‰
- **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•å¤šä¸ªæ¨¡å—é…åˆå·¥ä½œ
- **ç³»ç»Ÿæµ‹è¯•**ï¼šæµ‹è¯•æ•´ä¸ªåº”ç”¨åœ¨çœŸå®ç¯å¢ƒè¿è¡Œ

### 1.2 ä¸ºä»€ä¹ˆè¦å†™æµ‹è¯•


**ğŸ”¥ æ ¸å¿ƒä»·å€¼**
```
æ²¡æœ‰æµ‹è¯•çš„ä»£ç  = åœ¨èµ°é’¢ä¸æ²¡æœ‰å®‰å…¨ç½‘

âœ… å‘ç°Bugï¼šæå‰å‘ç°é—®é¢˜ï¼Œè€Œä¸æ˜¯ç”¨æˆ·å‘ç°
âœ… é‡æ„ä¿¡å¿ƒï¼šæ”¹ä»£ç ä¸æ€•å‡ºé”™
âœ… æ–‡æ¡£ä½œç”¨ï¼šæµ‹è¯•ç”¨ä¾‹å°±æ˜¯æ´»æ–‡æ¡£
âœ… æå‡è´¨é‡ï¼šå¼ºåˆ¶æ€è€ƒè¾¹ç•Œæƒ…å†µ
```

**å®é™…åœºæ™¯å¯¹æ¯”**
```
åœºæ™¯ï¼šä¿®æ”¹ç™»å½•åŠŸèƒ½

âŒ æ²¡æœ‰æµ‹è¯•ï¼š
æ”¹å®Œä»£ç  â†’ æ‰‹åŠ¨æµ‹è¯• â†’ å‘ç°é—®é¢˜ â†’ å†æ”¹ â†’ å†æµ‹è¯•
ï¼ˆè€—æ—¶ã€å®¹æ˜“é—æ¼ã€é‡å¤åŠ³åŠ¨ï¼‰

âœ… æœ‰æµ‹è¯•ï¼š
æ”¹å®Œä»£ç  â†’ è¿è¡Œæµ‹è¯• â†’ 3ç§’çŸ¥é“ç»“æœ â†’ å¿«é€Ÿä¿®å¤
ï¼ˆè‡ªåŠ¨åŒ–ã€å…¨é¢ã€å¯é‡å¤ï¼‰
```

### 1.3 æµ‹è¯•é‡‘å­—å¡”åŸåˆ™


**ğŸ“Š æµ‹è¯•å±‚æ¬¡ç»“æ„**
```
        /\
       /  \  ç³»ç»Ÿæµ‹è¯•ï¼ˆå°‘é‡ï¼‰
      /____\
     /      \
    / é›†æˆæµ‹è¯• \ ï¼ˆé€‚é‡ï¼‰
   /___________\
  /             \
 /   å•å…ƒæµ‹è¯•    \ï¼ˆå¤§é‡ï¼‰
/_________________\

åŸåˆ™ï¼š
ğŸ”¸ å•å…ƒæµ‹è¯•å 70%ï¼šå¿«é€Ÿã€ç¨³å®šã€æ˜“ç»´æŠ¤
ğŸ”¸ é›†æˆæµ‹è¯•å 20%ï¼šéªŒè¯æ¨¡å—åä½œ
ğŸ”¸ ç³»ç»Ÿæµ‹è¯•å 10%ï¼šéªŒè¯æ•´ä½“åŠŸèƒ½
```

---

## 2. âš™ï¸ JUnit5æµ‹è¯•æ¡†æ¶


### 2.1 JUnit5åŸºæœ¬ä½¿ç”¨


**ğŸ”¸ ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹**

```java
// è¢«æµ‹è¯•çš„ä¸šåŠ¡ç±»
public class Calculator {
    public int add(int a, int b) {
        return a + b;
    }
    
    public int divide(int a, int b) {
        if (b == 0) {
            throw new IllegalArgumentException("é™¤æ•°ä¸èƒ½ä¸º0");
        }
        return a / b;
    }
}

// æµ‹è¯•ç±»ï¼ˆç±»åé€šå¸¸æ˜¯ è¢«æµ‹ç±»å + Testï¼‰
class CalculatorTest {
    
    // @Test è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•
    @Test
    void testAdd() {
        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        Calculator calc = new Calculator();
        
        // 2. æ‰§è¡Œè¢«æµ‹è¯•æ–¹æ³•
        int result = calc.add(2, 3);
        
        // 3. éªŒè¯ç»“æœï¼ˆæ–­è¨€ï¼‰
        assertEquals(5, result, "2+3åº”è¯¥ç­‰äº5");
    }
    
    @Test
    void testDivide() {
        Calculator calc = new Calculator();
        
        // æµ‹è¯•æ­£å¸¸æƒ…å†µ
        assertEquals(2, calc.divide(6, 3));
        
        // æµ‹è¯•å¼‚å¸¸æƒ…å†µ
        assertThrows(IllegalArgumentException.class, 
            () -> calc.divide(10, 0),
            "é™¤ä»¥0åº”è¯¥æŠ›å‡ºå¼‚å¸¸"
        );
    }
}
```

**ğŸ’¡ æµ‹è¯•æ–¹æ³•çš„ä¸‰éƒ¨æ›²**
```
1ï¸âƒ£ Arrangeï¼ˆå‡†å¤‡ï¼‰ï¼šåˆ›å»ºå¯¹è±¡ã€å‡†å¤‡æ•°æ®
2ï¸âƒ£ Actï¼ˆæ‰§è¡Œï¼‰ï¼šè°ƒç”¨è¦æµ‹è¯•çš„æ–¹æ³•
3ï¸âƒ£ Assertï¼ˆæ–­è¨€ï¼‰ï¼šéªŒè¯ç»“æœæ˜¯å¦æ­£ç¡®
```

### 2.2 å¸¸ç”¨æ–­è¨€æ–¹æ³•


| æ–­è¨€æ–¹æ³• | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|---------|------|---------|
| `assertEquals(æœŸæœ›å€¼, å®é™…å€¼)` | åˆ¤æ–­ä¸¤ä¸ªå€¼ç›¸ç­‰ | éªŒè¯è®¡ç®—ç»“æœ |
| `assertTrue(æ¡ä»¶)` | åˆ¤æ–­æ¡ä»¶ä¸ºçœŸ | éªŒè¯å¸ƒå°”å€¼ |
| `assertNull(å¯¹è±¡)` | åˆ¤æ–­å¯¹è±¡ä¸ºnull | éªŒè¯ç©ºå€¼å¤„ç† |
| `assertThrows(å¼‚å¸¸.class, ä»£ç å—)` | éªŒè¯æŠ›å‡ºå¼‚å¸¸ | éªŒè¯å¼‚å¸¸å¤„ç† |
| `assertAll(å¤šä¸ªæ–­è¨€)` | æ‰¹é‡æ‰§è¡Œæ–­è¨€ | ä¸€æ¬¡éªŒè¯å¤šä¸ªæ¡ä»¶ |

**å®ç”¨ç¤ºä¾‹**
```java
@Test
void testUserValidation() {
    User user = new User("å¼ ä¸‰", 25);
    
    // ç»„åˆå¤šä¸ªæ–­è¨€
    assertAll("ç”¨æˆ·ä¿¡æ¯éªŒè¯",
        () -> assertEquals("å¼ ä¸‰", user.getName()),
        () -> assertTrue(user.getAge() > 0),
        () -> assertNotNull(user.getId())
    );
}
```

### 2.3 æµ‹è¯•ç”Ÿå‘½å‘¨æœŸ


**ğŸ”¸ ç”Ÿå‘½å‘¨æœŸæ³¨è§£**

```java
class UserServiceTest {
    
    private UserService userService;
    
    // æ‰€æœ‰æµ‹è¯•å‰æ‰§è¡Œä¸€æ¬¡ï¼ˆç±»çº§åˆ«ï¼‰
    @BeforeAll
    static void setupAll() {
        System.out.println("=== å¼€å§‹æµ‹è¯• ===");
    }
    
    // æ¯ä¸ªæµ‹è¯•å‰æ‰§è¡Œï¼ˆæ–¹æ³•çº§åˆ«ï¼‰
    @BeforeEach
    void setup() {
        userService = new UserService();
        System.out.println("åˆ›å»ºæµ‹è¯•å¯¹è±¡");
    }
    
    @Test
    void test1() {
        // æµ‹è¯•é€»è¾‘
    }
    
    @Test
    void test2() {
        // æµ‹è¯•é€»è¾‘
    }
    
    // æ¯ä¸ªæµ‹è¯•åæ‰§è¡Œ
    @AfterEach
    void tearDown() {
        System.out.println("æ¸…ç†æµ‹è¯•å¯¹è±¡");
    }
    
    // æ‰€æœ‰æµ‹è¯•åæ‰§è¡Œä¸€æ¬¡
    @AfterAll
    static void tearDownAll() {
        System.out.println("=== æµ‹è¯•ç»“æŸ ===");
    }
}
```

**æ‰§è¡Œé¡ºåºç¤ºæ„**
```
=== å¼€å§‹æµ‹è¯• ===
åˆ›å»ºæµ‹è¯•å¯¹è±¡ â†’ test1() â†’ æ¸…ç†æµ‹è¯•å¯¹è±¡
åˆ›å»ºæµ‹è¯•å¯¹è±¡ â†’ test2() â†’ æ¸…ç†æµ‹è¯•å¯¹è±¡
=== æµ‹è¯•ç»“æŸ ===
```

### 2.4 å‚æ•°åŒ–æµ‹è¯•


**ğŸ¯ å‡å°‘é‡å¤ä»£ç **

```java
class StringUtilTest {
    
    // å¤šç»„å‚æ•°æµ‹è¯•åŒä¸€ä¸ªæ–¹æ³•
    @ParameterizedTest
    @ValueSource(strings = {"hello", "world", "java"})
    void testNotEmpty(String input) {
        assertFalse(input.isEmpty());
    }
    
    // CSVæ ¼å¼æµ‹è¯•å¤šä¸ªå‚æ•°
    @ParameterizedTest
    @CsvSource({
        "apple, 5",
        "banana, 6",
        "cherry, 6"
    })
    void testStringLength(String word, int length) {
        assertEquals(length, word.length());
    }
}
```

**ä¼˜åŠ¿å¯¹æ¯”**
```
âŒ ä¼ ç»Ÿæ–¹å¼ï¼šå†™10ä¸ªæ–¹æ³•æµ‹è¯•10ç»„æ•°æ®
âœ… å‚æ•°åŒ–ï¼š1ä¸ªæ–¹æ³•æµ‹è¯•10ç»„æ•°æ®
```

---

## 3. ğŸŒ± Spring Testæµ‹è¯•æ”¯æŒ


### 3.1 @SpringBootTestæ³¨è§£


**ğŸ”¸ å®Œæ•´Springç¯å¢ƒæµ‹è¯•**

```java
// å¯åŠ¨å®Œæ•´çš„Springå®¹å™¨
@SpringBootTest
class OrderServiceTest {
    
    // è‡ªåŠ¨æ³¨å…¥çœŸå®çš„Bean
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Test
    void testCreateOrder() {
        // ç›´æ¥ä½¿ç”¨æ³¨å…¥çš„å¯¹è±¡
        Order order = orderService.createOrder("user123", "product456");
        
        assertNotNull(order.getId());
        assertEquals("user123", order.getUserId());
    }
}
```

**å·¥ä½œåŸç†**
```
@SpringBootTeståšäº†ä»€ä¹ˆï¼š
1ï¸âƒ£ å¯åŠ¨Springå®¹å™¨
2ï¸âƒ£ åŠ è½½æ‰€æœ‰é…ç½®
3ï¸âƒ£ è‡ªåŠ¨è£…é…Bean
4ï¸âƒ£ æä¾›çœŸå®è¿è¡Œç¯å¢ƒ

é€‚ç”¨åœºæ™¯ï¼š
âœ… éœ€è¦æµ‹è¯•Beanä¹‹é—´çš„äº¤äº’
âœ… éœ€è¦åŠ è½½é…ç½®æ–‡ä»¶
âœ… é›†æˆæµ‹è¯•
```

### 3.2 æµ‹è¯•é…ç½®ç®¡ç†


**ğŸ”§ ä¸“å±æµ‹è¯•é…ç½®**

```java
// æ–¹å¼1ï¼šä½¿ç”¨æµ‹è¯•é…ç½®æ–‡ä»¶
// resources/application-test.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb  # å†…å­˜æ•°æ®åº“
  jpa:
    show-sql: true           # æ˜¾ç¤ºSQL

// æµ‹è¯•ç±»æŒ‡å®šé…ç½®
@SpringBootTest
@ActiveProfiles("test")  // ä½¿ç”¨testé…ç½®
class UserServiceIntegrationTest {
    // ...
}
```

```java
// æ–¹å¼2ï¼šä½¿ç”¨æµ‹è¯•ä¸“ç”¨é…ç½®ç±»
@TestConfiguration
class TestConfig {
    
    @Bean
    public UserService testUserService() {
        return new UserService(mockUserRepository());
    }
    
    @Bean
    public UserRepository mockUserRepository() {
        // è¿”å›æ¨¡æ‹Ÿçš„Repository
        return Mockito.mock(UserRepository.class);
    }
}

@SpringBootTest
@Import(TestConfig.class)  // å¯¼å…¥æµ‹è¯•é…ç½®
class MyTest {
    // ...
}
```

**é…ç½®ç­–ç•¥**
```
ç”Ÿäº§ç¯å¢ƒ â†’ MySQLæ•°æ®åº“ã€çœŸå®Redis
æµ‹è¯•ç¯å¢ƒ â†’ H2å†…å­˜åº“ã€åµŒå…¥å¼Redis

å¥½å¤„ï¼š
ğŸ”¸ ä¸å½±å“ç”Ÿäº§æ•°æ®
ğŸ”¸ æµ‹è¯•é€Ÿåº¦å¿«
ğŸ”¸ å¯é‡å¤æ‰§è¡Œ
```

---

## 4. ğŸŒ Webå±‚æµ‹è¯•


### 4.1 @WebMvcTestæ³¨è§£


**ğŸ”¸ è½»é‡çº§Controlleræµ‹è¯•**

```java
// åªåŠ è½½Webå±‚ï¼Œä¸åŠ è½½Serviceå’ŒRepository
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    // æ¨¡æ‹ŸHTTPè¯·æ±‚çš„å·¥å…·
    @Autowired
    private MockMvc mockMvc;
    
    // Mockæ‰Serviceå±‚ï¼ˆå› ä¸ºæ²¡åŠ è½½ï¼‰
    @MockBean
    private UserService userService;
    
    @Test
    void testGetUser() throws Exception {
        // 1. å‡†å¤‡æ¨¡æ‹Ÿæ•°æ®
        User mockUser = new User(1L, "å¼ ä¸‰", "zhangsan@example.com");
        when(userService.findById(1L)).thenReturn(mockUser);
        
        // 2. å‘é€GETè¯·æ±‚
        mockMvc.perform(get("/users/1"))
            // 3. éªŒè¯å“åº”
            .andExpect(status().isOk())                    // çŠ¶æ€ç 200
            .andExpect(jsonPath("$.name").value("å¼ ä¸‰"))   // JSONå­—æ®µ
            .andExpect(jsonPath("$.email").exists());      // å­—æ®µå­˜åœ¨
    }
    
    @Test
    void testCreateUser() throws Exception {
        String userJson = "{\"name\":\"æå››\",\"email\":\"lisi@example.com\"}";
        
        mockMvc.perform(post("/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(userJson))
            .andExpect(status().isCreated())
            .andExpect(header().exists("Location"));  // è¿”å›Locationå¤´
    }
}
```

**ğŸ’¡ MockMvcå¸¸ç”¨æ–¹æ³•**
```
è¯·æ±‚æ„å»ºï¼š
- get("/path") â†’ GETè¯·æ±‚
- post("/path") â†’ POSTè¯·æ±‚
- param("key", "value") â†’ æ·»åŠ å‚æ•°
- header("key", "value") â†’ æ·»åŠ è¯·æ±‚å¤´

å“åº”éªŒè¯ï¼š
- status().isOk() â†’ çŠ¶æ€ç 200
- content().string("hello") â†’ å“åº”å†…å®¹
- jsonPath("$.name") â†’ JSONè·¯å¾„
```

### 4.2 å®Œæ•´è¯·æ±‚æµ‹è¯•


**ğŸ¯ çœŸå®åœºæ™¯æ¨¡æ‹Ÿ**

```java
@Test
void testUserLogin() throws Exception {
    LoginRequest request = new LoginRequest("user123", "password");
    
    mockMvc.perform(post("/api/login")
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request)))
        .andExpect(status().isOk())
        .andExpect(jsonPath("$.token").exists())
        .andExpect(cookie().exists("SESSION"))  // æ£€æŸ¥Cookie
        .andDo(print());  // æ‰“å°è¯·æ±‚å“åº”è¯¦æƒ…
}
```

---

## 5. ğŸ’¾ æ•°æ®å±‚æµ‹è¯•


### 5.1 @DataJpaTestæ³¨è§£


**ğŸ”¸ Repositoryå±‚æµ‹è¯•**

```java
// åªåŠ è½½JPAç›¸å…³é…ç½®ï¼Œä½¿ç”¨å†…å­˜æ•°æ®åº“
@DataJpaTest
class UserRepositoryTest {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private TestEntityManager entityManager;  // æµ‹è¯•ä¸“ç”¨å·¥å…·
    
    @Test
    void testFindByEmail() {
        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        User user = new User("æµ‹è¯•ç”¨æˆ·", "test@example.com");
        entityManager.persist(user);
        entityManager.flush();  // ç«‹å³åŒæ­¥åˆ°æ•°æ®åº“
        
        // 2. æ‰§è¡ŒæŸ¥è¯¢
        User found = userRepository.findByEmail("test@example.com");
        
        // 3. éªŒè¯ç»“æœ
        assertNotNull(found);
        assertEquals("æµ‹è¯•ç”¨æˆ·", found.getName());
    }
    
    @Test
    void testCustomQuery() {
        // æµ‹è¯•è‡ªå®šä¹‰æŸ¥è¯¢
        List<User> users = userRepository.findActiveUsers();
        
        assertTrue(users.stream()
            .allMatch(u -> u.isActive()));
    }
}
```

**å·¥ä½œæœºåˆ¶**
```
@DataJpaTeståšäº†ä»€ä¹ˆï¼š
1ï¸âƒ£ ä½¿ç”¨H2å†…å­˜æ•°æ®åº“ï¼ˆä¸å½±å“çœŸå®æ•°æ®ï¼‰
2ï¸âƒ£ è‡ªåŠ¨é…ç½®JPAå’Œæ•°æ®æº
3ï¸âƒ£ æ¯ä¸ªæµ‹è¯•è‡ªåŠ¨å›æ»šï¼ˆä¸ç•™ç—•è¿¹ï¼‰
4ï¸âƒ£ æä¾›TestEntityManagerå·¥å…·

ä¼˜åŠ¿ï¼š
âœ… æµ‹è¯•é€Ÿåº¦å¿«ï¼ˆå†…å­˜æ•°æ®åº“ï¼‰
âœ… æ•°æ®éš”ç¦»ï¼ˆè‡ªåŠ¨å›æ»šï¼‰
âœ… ä¸éœ€è¦æ¸…ç†æ•°æ®
```

### 5.2 äº‹åŠ¡ç®¡ç†æµ‹è¯•


```java
@DataJpaTest
class TransactionTest {
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    @Rollback(false)  // ä¸å›æ»šï¼Œä¿ç•™æ•°æ®ï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰
    void testSaveUser() {
        User user = new User("æ°¸ä¹…ç”¨æˆ·", "permanent@example.com");
        userRepository.save(user);
        // æµ‹è¯•ç»“æŸæ•°æ®ä¼šä¿ç•™
    }
    
    @Test
    void testDefaultRollback() {
        User user = new User("ä¸´æ—¶ç”¨æˆ·", "temp@example.com");
        userRepository.save(user);
        // æµ‹è¯•ç»“æŸè‡ªåŠ¨å›æ»šï¼Œæ•°æ®æ¶ˆå¤±
    }
}
```

---

## 6. ğŸ­ æ¨¡æ‹Ÿæµ‹è¯•æŠ€æœ¯


### 6.1 MockMvcæ¨¡æ‹ŸHTTPè¯·æ±‚


**ğŸ”¸ ä¸å¯åŠ¨æœåŠ¡å™¨æµ‹è¯•API**

```java
@WebMvcTest
class ProductControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private ProductService productService;
    
    @Test
    void testSearchProducts() throws Exception {
        // å‡†å¤‡æ¨¡æ‹Ÿè¿”å›æ•°æ®
        List<Product> products = Arrays.asList(
            new Product("å•†å“1", 99.9),
            new Product("å•†å“2", 199.9)
        );
        when(productService.search("å…³é”®è¯")).thenReturn(products);
        
        // å‘é€è¯·æ±‚å¹¶éªŒè¯
        mockMvc.perform(get("/products/search")
                .param("keyword", "å…³é”®è¯"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$", hasSize(2)))
            .andExpect(jsonPath("$[0].name").value("å•†å“1"));
    }
}
```

### 6.2 Mockitoæ¨¡æ‹Ÿå¯¹è±¡


**ğŸ”¸ éš”ç¦»å¤–éƒ¨ä¾èµ–**

```java
class OrderServiceTest {
    
    @Mock  // åˆ›å»ºæ¨¡æ‹Ÿå¯¹è±¡
    private PaymentService paymentService;
    
    @Mock
    private InventoryService inventoryService;
    
    @InjectMocks  // è‡ªåŠ¨æ³¨å…¥Mockå¯¹è±¡
    private OrderService orderService;
    
    @BeforeEach
    void setup() {
        MockitoAnnotations.openMocks(this);
    }
    
    @Test
    void testCreateOrder() {
        // å®šä¹‰æ¨¡æ‹Ÿè¡Œä¸º
        when(inventoryService.checkStock("product123", 2))
            .thenReturn(true);
        when(paymentService.charge(100.0))
            .thenReturn("paymentId123");
        
        // æ‰§è¡Œæµ‹è¯•
        Order order = orderService.createOrder("product123", 2);
        
        // éªŒè¯è°ƒç”¨
        verify(inventoryService).checkStock("product123", 2);
        verify(paymentService).charge(100.0);
        
        assertNotNull(order);
    }
    
    @Test
    void testOrderFailWhenOutOfStock() {
        // æ¨¡æ‹Ÿåº“å­˜ä¸è¶³
        when(inventoryService.checkStock(any(), anyInt()))
            .thenReturn(false);
        
        // éªŒè¯æŠ›å‡ºå¼‚å¸¸
        assertThrows(OutOfStockException.class, 
            () -> orderService.createOrder("product123", 100));
        
        // éªŒè¯æ²¡æœ‰è°ƒç”¨æ”¯ä»˜
        verify(paymentService, never()).charge(anyDouble());
    }
}
```

**Mockitoæ ¸å¿ƒæ–¹æ³•**
```
å®šä¹‰è¡Œä¸ºï¼š
- when(æ–¹æ³•è°ƒç”¨).thenReturn(è¿”å›å€¼)
- when(æ–¹æ³•è°ƒç”¨).thenThrow(å¼‚å¸¸)
- doNothing().when(å¯¹è±¡).æ–¹æ³•()

éªŒè¯è°ƒç”¨ï¼š
- verify(å¯¹è±¡).æ–¹æ³•()
- verify(å¯¹è±¡, times(3)).æ–¹æ³•()
- verify(å¯¹è±¡, never()).æ–¹æ³•()

å‚æ•°åŒ¹é…ï¼š
- any() â†’ ä»»æ„å‚æ•°
- eq(å€¼) â†’ ç²¾ç¡®åŒ¹é…
- anyInt() â†’ ä»»æ„æ•´æ•°
```

### 6.3 TestContainerså®¹å™¨æµ‹è¯•


**ğŸ³ çœŸå®ç¯å¢ƒæµ‹è¯•**

```java
// ä½¿ç”¨Dockerå®¹å™¨è¿è¡ŒçœŸå®æ•°æ®åº“
@SpringBootTest
@Testcontainers
class DatabaseIntegrationTest {
    
    @Container
    static MySQLContainer<?> mysql = new MySQLContainer<>("mysql:8.0")
        .withDatabaseName("testdb")
        .withUsername("test")
        .withPassword("test");
    
    @DynamicPropertySource
    static void properties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", mysql::getJdbcUrl);
        registry.add("spring.datasource.username", mysql::getUsername);
        registry.add("spring.datasource.password", mysql::getPassword);
    }
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    void testWithRealDatabase() {
        // ä½¿ç”¨çœŸå®MySQLå®¹å™¨æµ‹è¯•
        User user = new User("çœŸå®æµ‹è¯•", "real@example.com");
        userRepository.save(user);
        
        User found = userRepository.findById(user.getId()).orElse(null);
        assertNotNull(found);
    }
}
```

**åº”ç”¨åœºæ™¯**
```
ğŸ”¸ H2å†…å­˜åº“æµ‹è¯•ï¼šå¿«é€Ÿã€è½»é‡ï¼Œé€‚åˆç®€å•åœºæ™¯
ğŸ”¸ TestContainersï¼šçœŸå®ç¯å¢ƒï¼Œé€‚åˆå¤æ‚SQLã€ç‰¹å®šæ•°æ®åº“ç‰¹æ€§
```

---

## 7. ğŸ“Š æµ‹è¯•æ•°æ®ç®¡ç†


### 7.1 æµ‹è¯•æ•°æ®å‡†å¤‡ç­–ç•¥


**ğŸ”¸ å¤šç§å‡†å¤‡æ–¹å¼**

```java
// æ–¹å¼1ï¼šç›´æ¥åœ¨æµ‹è¯•ä¸­åˆ›å»º
@Test
void testWithInlineData() {
    User user = new User("å¼ ä¸‰", "zhangsan@example.com");
    userRepository.save(user);
    // ...
}

// æ–¹å¼2ï¼šä½¿ç”¨@BeforeEachç»Ÿä¸€å‡†å¤‡
class UserServiceTest {
    
    private User testUser;
    
    @BeforeEach
    void prepareData() {
        testUser = new User("æµ‹è¯•ç”¨æˆ·", "test@example.com");
        userRepository.save(testUser);
    }
    
    @Test
    void test1() {
        // ä½¿ç”¨å‡†å¤‡å¥½çš„testUser
    }
}

// æ–¹å¼3ï¼šä½¿ç”¨@Sqlè„šæœ¬
@SpringBootTest
@Sql("/test-data.sql")  // æ‰§è¡ŒSQLè„šæœ¬
class IntegrationTest {
    @Test
    void testWithSqlData() {
        // æ•°æ®å·²é€šè¿‡SQLè„šæœ¬æ’å…¥
        List<User> users = userRepository.findAll();
        assertEquals(10, users.size());
    }
}
```

**test-data.sqlç¤ºä¾‹**
```sql
-- resources/test-data.sql
INSERT INTO users (name, email) VALUES 
    ('ç”¨æˆ·1', 'user1@example.com'),
    ('ç”¨æˆ·2', 'user2@example.com'),
    ('ç”¨æˆ·3', 'user3@example.com');
```

### 7.2 æµ‹è¯•æ•°æ®éš”ç¦»


**ğŸ›¡ï¸ é¿å…æ•°æ®æ±¡æŸ“**

```java
@DataJpaTest
class DataIsolationTest {
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    @Transactional  // è‡ªåŠ¨å›æ»š
    void test1() {
        userRepository.save(new User("ä¸´æ—¶æ•°æ®", "temp@example.com"));
        // æµ‹è¯•ç»“æŸè‡ªåŠ¨åˆ é™¤
    }
    
    @Test
    void test2() {
        // ä¸ä¼šçœ‹åˆ°test1çš„æ•°æ®
        assertEquals(0, userRepository.count());
    }
}
```

---

## 8. âœ… æµ‹è¯•æœ€ä½³å®è·µ


### 8.1 æµ‹è¯•è¦†ç›–ç‡


**ğŸ“ˆ ä»£ç è¦†ç›–ç‡ç»Ÿè®¡**

```xml
<!-- pom.xml æ·»åŠ JaCoCoæ’ä»¶ -->
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.8</version>
    <executions>
        <execution>
            <goals>
                <goal>prepare-agent</goal>
                <goal>report</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

**è¿è¡Œè¦†ç›–ç‡æŠ¥å‘Š**
```bash
mvn clean test jacoco:report

# æŸ¥çœ‹æŠ¥å‘Šï¼štarget/site/jacoco/index.html
```

**è¦†ç›–ç‡æŒ‡æ ‡**
```
ğŸ¯ è¡Œè¦†ç›–ç‡ï¼šä»£ç è¡Œæ‰§è¡Œæ¯”ä¾‹ï¼ˆå»ºè®® > 80%ï¼‰
ğŸ¯ åˆ†æ”¯è¦†ç›–ç‡ï¼šæ¡ä»¶åˆ†æ”¯è¦†ç›–ï¼ˆå»ºè®® > 70%ï¼‰
ğŸ¯ æ–¹æ³•è¦†ç›–ç‡ï¼šæ–¹æ³•æ‰§è¡Œæ¯”ä¾‹ï¼ˆå»ºè®® > 90%ï¼‰

æ³¨æ„ï¼šè¦†ç›–ç‡ä¸æ˜¯å”¯ä¸€æ ‡å‡†ï¼Œè´¨é‡æ¯”æ•°é‡é‡è¦ï¼
```

### 8.2 é›†æˆæµ‹è¯•ç­–ç•¥


**ğŸ”„ åˆ†å±‚æµ‹è¯•æ–¹æ³•**

```java
// å•å…ƒæµ‹è¯•ï¼šæµ‹è¯•å•ä¸ªæ–¹æ³•
@Test
void unitTest() {
    Calculator calc = new Calculator();
    assertEquals(5, calc.add(2, 3));
}

// é›†æˆæµ‹è¯•ï¼šæµ‹è¯•å¤šä¸ªç»„ä»¶
@SpringBootTest
class IntegrationTest {
    
    @Autowired
    private OrderService orderService;  // ä¼šè°ƒç”¨Repository
    
    @Test
    void integrationTest() {
        Order order = orderService.createOrder("user123", "product456");
        assertNotNull(order.getId());  // éªŒè¯æ•°æ®åº“æ“ä½œ
    }
}

// ç«¯åˆ°ç«¯æµ‹è¯•ï¼šæµ‹è¯•å®Œæ•´æµç¨‹
@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
class E2ETest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @Test
    void e2eTest() {
        // æ¨¡æ‹ŸçœŸå®HTTPè¯·æ±‚
        ResponseEntity<Order> response = restTemplate.postForEntity(
            "/orders", 
            orderRequest, 
            Order.class
        );
        assertEquals(HttpStatus.CREATED, response.getStatusCode());
    }
}
```

### 8.3 æµ‹è¯•å‘½åè§„èŒƒ


**ğŸ“ æ¸…æ™°çš„å‘½åçº¦å®š**

```java
// âœ… å¥½çš„å‘½åï¼šè¯´æ˜æµ‹è¯•ä»€ä¹ˆ
@Test
void shouldReturnUserWhenEmailExists() { }

@Test
void shouldThrowExceptionWhenEmailIsInvalid() { }

@Test
void shouldCalculateDiscountCorrectlyForVipUser() { }

// âŒ ä¸å¥½çš„å‘½åï¼šçœ‹ä¸å‡ºæµ‹è¯•ä»€ä¹ˆ
@Test
void test1() { }

@Test
void testUser() { }
```

**å‘½åæ¨¡æ¿**
```
should[æœŸæœ›è¡Œä¸º]When[æ¡ä»¶]

ä¾‹å¦‚ï¼š
shouldReturnEmptyListWhenNoDataExists
shouldSendEmailWhenOrderIsPlaced
shouldRejectPaymentWhenBalanceInsufficient
```

### 8.4 å¸¸è§é™·é˜±ä¸è§£å†³


**âš ï¸ æµ‹è¯•ä¸­çš„å¸¸è§é—®é¢˜**

| é—®é¢˜ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| **æµ‹è¯•ä¾èµ–é¡ºåº** | æµ‹è¯•1æˆåŠŸåæµ‹è¯•2æ‰èƒ½æˆåŠŸ | æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ï¼Œä½¿ç”¨@BeforeEachå‡†å¤‡æ•°æ® |
| **éšæœºå¤±è´¥** | æœ‰æ—¶æˆåŠŸæœ‰æ—¶å¤±è´¥ | é¿å…ä¾èµ–æ—¶é—´ã€éšæœºæ•°ï¼Œä½¿ç”¨å›ºå®šå€¼ |
| **è¿‡åº¦Mock** | Mockäº†æ‰€æœ‰ä¸œè¥¿ï¼Œæµ‹è¯•æ— æ„ä¹‰ | åªMockå¤–éƒ¨ä¾èµ–ï¼Œä¿ç•™æ ¸å¿ƒé€»è¾‘ |
| **æµ‹è¯•è¿è¡Œæ…¢** | è·‘ä¸€æ¬¡æµ‹è¯•è¦å‡ åˆ†é’Ÿ | ä½¿ç”¨@WebMvcTestæ›¿ä»£@SpringBootTest |

**ç¤ºä¾‹ï¼šé¿å…æµ‹è¯•ä¾èµ–**
```java
// âŒ é”™è¯¯ï¼šæµ‹è¯•2ä¾èµ–æµ‹è¯•1
class BadTest {
    private User savedUser;
    
    @Test
    void test1_saveUser() {
        savedUser = userRepository.save(new User("å¼ ä¸‰"));
    }
    
    @Test
    void test2_updateUser() {
        savedUser.setName("æå››");  // ä¾èµ–test1çš„ç»“æœ
        userRepository.save(savedUser);
    }
}

// âœ… æ­£ç¡®ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹
class GoodTest {
    
    @Test
    void testSaveUser() {
        User user = userRepository.save(new User("å¼ ä¸‰"));
        assertNotNull(user.getId());
    }
    
    @Test
    void testUpdateUser() {
        User user = userRepository.save(new User("å¼ ä¸‰"));  // ç‹¬ç«‹å‡†å¤‡
        user.setName("æå››");
        userRepository.save(user);
        assertEquals("æå››", userRepository.findById(user.getId()).get().getName());
    }
}
```

---

## ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æµ‹è¯•ç±»å‹ï¼šå•å…ƒæµ‹è¯•ï¼ˆ70%ï¼‰ã€é›†æˆæµ‹è¯•ï¼ˆ20%ï¼‰ã€ç³»ç»Ÿæµ‹è¯•ï¼ˆ10%ï¼‰
ğŸ”¸ JUnit5ï¼š@Testã€æ–­è¨€ã€ç”Ÿå‘½å‘¨æœŸã€å‚æ•°åŒ–æµ‹è¯•
ğŸ”¸ Spring Testï¼š@SpringBootTestã€@WebMvcTestã€@DataJpaTest
ğŸ”¸ MockMvcï¼šæ¨¡æ‹ŸHTTPè¯·æ±‚ï¼Œæµ‹è¯•Controller
ğŸ”¸ Mockitoï¼šMockå¤–éƒ¨ä¾èµ–ï¼Œéš”ç¦»æµ‹è¯•
ğŸ”¸ TestContainersï¼šä½¿ç”¨çœŸå®å®¹å™¨æµ‹è¯•
ğŸ”¸ è¦†ç›–ç‡ï¼šJaCoCoç»Ÿè®¡ä»£ç è¦†ç›–ç‡
```

### æµ‹è¯•å¼€å‘æµç¨‹


```
ç¼–å†™åŠŸèƒ½ä»£ç 
    â†“
ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆæµ‹è¯•æ ¸å¿ƒé€»è¾‘ï¼‰
    â†“
ç¼–å†™é›†æˆæµ‹è¯•ï¼ˆæµ‹è¯•ç»„ä»¶åä½œï¼‰
    â†“
è¿è¡Œè¦†ç›–ç‡æ£€æŸ¥
    â†“
ä»£ç å®¡æŸ¥
    â†“
æŒç»­é›†æˆ
```

### å®æˆ˜å»ºè®®


**ğŸ¯ æ–°æ‰‹å­¦ä¹ è·¯å¾„**
```
1ï¸âƒ£ ä»ç®€å•çš„å•å…ƒæµ‹è¯•å¼€å§‹ï¼ˆJUnit5åŸºç¡€ï¼‰
2ï¸âƒ£ å­¦ä¹ æ–­è¨€å’Œç”Ÿå‘½å‘¨æœŸ
3ï¸âƒ£ æŒæ¡@SpringBootTesté›†æˆæµ‹è¯•
4ï¸âƒ£ å­¦ä¹ MockæŠ€æœ¯ï¼ˆMockitoï¼‰
5ï¸âƒ£ å®è·µWebå±‚å’Œæ•°æ®å±‚æµ‹è¯•
6ï¸âƒ£ äº†è§£æµ‹è¯•è¦†ç›–ç‡å’Œæœ€ä½³å®è·µ
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†**
- **æµ‹è¯•é‡‘å­—å¡”**ï¼šå•å…ƒæµ‹è¯•å¤šã€é›†æˆæµ‹è¯•é€‚é‡ã€ç³»ç»Ÿæµ‹è¯•å°‘é‡
- **AAAæ¨¡å¼**ï¼šArrangeå‡†å¤‡ã€Actæ‰§è¡Œã€Assertæ–­è¨€
- **æµ‹è¯•éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ï¼Œäº’ä¸å½±å“
- **é€‚åº¦Mock**ï¼šåªMockå¤–éƒ¨ä¾èµ–ï¼Œä¿ç•™æ ¸å¿ƒé€»è¾‘
- **æ¸…æ™°å‘½å**ï¼šæµ‹è¯•åç§°è¯´æ˜æµ‹è¯•å†…å®¹
- **æŒç»­æµ‹è¯•**ï¼šæ¯æ¬¡æäº¤éƒ½è¿è¡Œæµ‹è¯•

**ğŸ”¥ é¿å…è¯¯åŒº**
- âŒ ä¸å†™æµ‹è¯•ï¼Œå…¨é æ‰‹åŠ¨æµ‹
- âŒ æµ‹è¯•ä¾èµ–æ‰§è¡Œé¡ºåº
- âŒ è¿‡åº¦ä½¿ç”¨@SpringBootTestï¼ˆæ…¢ï¼‰
- âŒ ä¸ºäº†è¦†ç›–ç‡è€Œæµ‹è¯•æ— æ„ä¹‰ä»£ç 
- âœ… æµ‹è¯•æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- âœ… æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
- âœ… ä¿æŒæµ‹è¯•ç®€å•å¯ç»´æŠ¤