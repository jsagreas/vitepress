---
title: 1ã€å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¸çº¿ç¨‹å®‰å…¨
---
## ğŸ“š ç›®å½•

1. [å¹¶å‘ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ](#1-å¹¶å‘ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ)
2. [æ‰§è¡Œå•å…ƒè¯¦è§£](#2-æ‰§è¡Œå•å…ƒè¯¦è§£)
3. [å…±äº«èµ„æºä¸é€šä¿¡æ¨¡å¼](#3-å…±äº«èµ„æºä¸é€šä¿¡æ¨¡å¼)
4. [é”æœºåˆ¶ä¸åŒæ­¥é—®é¢˜](#4-é”æœºåˆ¶ä¸åŒæ­¥é—®é¢˜)
5. [åŸå­æ“ä½œä¸å†…å­˜ä¸€è‡´æ€§](#5-åŸå­æ“ä½œä¸å†…å­˜ä¸€è‡´æ€§)
6. [å¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ](#6-å¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ)
7. [ç°ä»£å¹¶å‘æ¨¡å‹](#7-ç°ä»£å¹¶å‘æ¨¡å‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ å¹¶å‘ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¹¶å‘ç¼–ç¨‹


**ğŸ”¸ é€šä¿—ç†è§£**
> å¹¶å‘ç¼–ç¨‹å°±åƒ**é¤å…åŒæ—¶æœåŠ¡å¤šä¸ªå®¢äºº**ï¼šå¨å¸ˆå¯ä»¥åŒæ—¶ç‚’èœã€ç…®æ±¤ã€çƒ¤é¢åŒ…ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªèœåšå®Œå†åšä¸‹ä¸€ä¸ªã€‚è¿™æ ·èƒ½å¤§å¤§æé«˜æ•ˆç‡ï¼Œè®©å®¢äººä¸ç”¨ç­‰å¤ªä¹…ã€‚

**ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ**
```
å¹¶å‘ â‰  å¹¶è¡Œ

å¹¶å‘(Concurrency)ï¼š
â€¢ çœ‹èµ·æ¥åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡
â€¢ å®é™…å¯èƒ½æ˜¯å¿«é€Ÿåˆ‡æ¢æ‰§è¡Œ
â€¢ å¼ºè°ƒä»»åŠ¡ç®¡ç†å’Œåè°ƒ

å¹¶è¡Œ(Parallelism)ï¼š
â€¢ çœŸæ­£åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡
â€¢ éœ€è¦å¤šä¸ªCPUæ ¸å¿ƒ
â€¢ å¼ºè°ƒåŒæ—¶æ‰§è¡Œçš„èƒ½åŠ›
```

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘ç¼–ç¨‹**

| **åœºæ™¯** | **ä¸²è¡Œæ‰§è¡Œé—®é¢˜** | **å¹¶å‘è§£å†³æ–¹æ¡ˆ** |
|---------|-----------------|-----------------|
| **ç½‘ç»œè¯·æ±‚** | `ç­‰å¾…å“åº”æ—¶CPUé—²ç½®` | `å¤„ç†å…¶ä»–è¯·æ±‚ï¼Œæé«˜ååé‡` |
| **æ–‡ä»¶è¯»å†™** | `IOç­‰å¾…æ—¶ç¨‹åºé˜»å¡` | `å¼‚æ­¥å¤„ç†ï¼Œå“åº”æ›´å¿«` |
| **ç”¨æˆ·ç•Œé¢** | `è®¡ç®—æ—¶ç•Œé¢å¡æ­»` | `åå°è®¡ç®—ï¼Œç•Œé¢ä¿æŒå“åº”` |
| **æ•°æ®å¤„ç†** | `å¤§é‡æ•°æ®å¤„ç†æ…¢` | `åˆ†ç‰‡å¹¶è¡Œå¤„ç†ï¼Œé€Ÿåº¦æ›´å¿«` |

### 1.2 å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜


**âš ï¸ ä¸»è¦éš¾é¢˜**
```
å¹¶å‘ç¼–ç¨‹ä¸‰å¤§éš¾é¢˜ï¼š

1. ç«äº‰æ¡ä»¶(Race Condition)
   å¤šä¸ªä»»åŠ¡åŒæ—¶ä¿®æ”¹å…±äº«æ•°æ®ï¼Œç»“æœä¸å¯é¢„æµ‹

2. æ­»é”(Deadlock)  
   ä»»åŠ¡ä¹‹é—´ç›¸äº’ç­‰å¾…èµ„æºï¼Œè°ä¹Ÿæ— æ³•ç»§ç»­

3. ä¸€è‡´æ€§é—®é¢˜
   æ•°æ®åœ¨ä¸åŒä»»åŠ¡é—´çš„å¯è§æ€§å’ŒåŒæ­¥é—®é¢˜
```

---

## 2. ğŸ—ï¸ æ‰§è¡Œå•å…ƒè¯¦è§£


### 2.1 çº¿ç¨‹(Thread)


**ğŸ§µ çº¿ç¨‹çš„æœ¬è´¨**
> çº¿ç¨‹å°±åƒ**å·¥å‚é‡Œçš„å·¥äºº**ï¼Œæ¯ä¸ªå·¥äººæœ‰è‡ªå·±çš„å·¥ä½œå°(æ ˆç©ºé—´)ï¼Œä½†å¤§å®¶å…±äº«å·¥å‚çš„åŸæ–™ä»“åº“(å †å†…å­˜)å’Œå·¥å…·(ç³»ç»Ÿèµ„æº)ã€‚

**ğŸ“Š çº¿ç¨‹ç‰¹ç‚¹**

```
çº¿ç¨‹å†…å­˜æ¨¡å‹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                è¿›ç¨‹ç©ºé—´                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   çº¿ç¨‹1     â”‚   çº¿ç¨‹2     â”‚   çº¿ç¨‹3     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç§æœ‰æ ˆç©ºé—´   â”‚ ç§æœ‰æ ˆç©ºé—´   â”‚ ç§æœ‰æ ˆç©ºé—´   â”‚
â”‚ å±€éƒ¨å˜é‡    â”‚ å±€éƒ¨å˜é‡    â”‚ å±€éƒ¨å˜é‡    â”‚
â”‚ å‡½æ•°è°ƒç”¨æ ˆ   â”‚ å‡½æ•°è°ƒç”¨æ ˆ   â”‚ å‡½æ•°è°ƒç”¨æ ˆ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           å…±äº«å †å†…å­˜å’Œç³»ç»Ÿèµ„æº            â”‚
â”‚         (å…¨å±€å˜é‡ã€æ–‡ä»¶ã€ç½‘ç»œç­‰)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ çº¿ç¨‹åˆ›å»ºç¤ºä¾‹**
```java
// Javaçº¿ç¨‹åˆ›å»º
class MyTask implements Runnable {
    private String taskName;
    
    public MyTask(String name) {
        this.taskName = name;
    }
    
    @Override
    public void run() {
        for (int i = 0; i < 5; i++) {
            System.out.println(taskName + " æ‰§è¡Œç¬¬ " + i + " æ­¥");
            try {
                Thread.sleep(1000); // æ¨¡æ‹Ÿå·¥ä½œ
            } catch (InterruptedException e) {
                break;
            }
        }
    }
}

// ä½¿ç”¨çº¿ç¨‹
Thread worker1 = new Thread(new MyTask("å·¥äººA"));
Thread worker2 = new Thread(new MyTask("å·¥äººB"));
worker1.start(); // å¼€å§‹å·¥ä½œ
worker2.start(); // åŒæ—¶å¼€å§‹å·¥ä½œ
```

### 2.2 è¿›ç¨‹(Process)


**ğŸ­ è¿›ç¨‹çš„æœ¬è´¨**
> è¿›ç¨‹å°±åƒ**ç‹¬ç«‹çš„å·¥å‚**ï¼Œæ¯ä¸ªå·¥å‚æœ‰è‡ªå·±å®Œæ•´çš„è®¾å¤‡ã€åŸæ–™ã€å·¥äººã€‚å·¥å‚ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚

**ğŸ”’ è¿›ç¨‹ç‰¹ç‚¹**
- **ç‹¬ç«‹å†…å­˜ç©ºé—´**ï¼šä¸€ä¸ªè¿›ç¨‹å´©æºƒä¸å½±å“å…¶ä»–è¿›ç¨‹
- **èµ„æºéš”ç¦»**ï¼šæ–‡ä»¶ã€ç½‘ç»œç­‰èµ„æºç›¸äº’ç‹¬ç«‹  
- **é€šä¿¡å¤æ‚**ï¼šéœ€è¦ç‰¹æ®Šæœºåˆ¶æ‰èƒ½äº’ç›¸é€šä¿¡
- **åˆ›å»ºå¼€é”€å¤§**ï¼šå¯åŠ¨æ–°è¿›ç¨‹æ¯”åˆ›å»ºçº¿ç¨‹æ…¢å¾ˆå¤š

**ğŸ“‹ çº¿ç¨‹vsè¿›ç¨‹å¯¹æ¯”**

| **ç‰¹æ€§** | **çº¿ç¨‹** | **è¿›ç¨‹** |
|---------|---------|---------|
| **å†…å­˜** | `å…±äº«è¿›ç¨‹å†…å­˜` | `ç‹¬ç«‹å†…å­˜ç©ºé—´` |
| **é€šä¿¡** | `ç›´æ¥è®¿é—®å…±äº«å˜é‡` | `éœ€è¦IPCæœºåˆ¶` |
| **åˆ›å»ºæˆæœ¬** | `è½»é‡ï¼Œæ¯«ç§’çº§` | `é‡é‡ï¼Œç§’çº§` |
| **å´©æºƒå½±å“** | `å¯èƒ½å½±å“æ•´ä¸ªè¿›ç¨‹` | `ç›¸äº’ç‹¬ç«‹` |
| **é€‚ç”¨åœºæ™¯** | `åŒä¸€ç¨‹åºå†…å¹¶å‘` | `ä¸åŒç¨‹åºé—´éš”ç¦»` |

### 2.3 åç¨‹(Coroutine)


**ğŸ­ åç¨‹çš„æœ¬è´¨**
> åç¨‹å°±åƒ**æ‚æŠ€æ¼”å‘˜**ï¼Œå¯ä»¥åœ¨è¡¨æ¼”ä¸­é€”æš‚åœï¼Œè®©å…¶ä»–æ¼”å‘˜ä¸Šå°ï¼Œç„¶åå†ä»æš‚åœçš„åœ°æ–¹ç»§ç»­è¡¨æ¼”ã€‚è¿™ç§"ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒ"çš„æ–¹å¼éå¸¸é«˜æ•ˆã€‚

**âš¡ åç¨‹ä¼˜åŠ¿**
```
åç¨‹ vs çº¿ç¨‹ï¼š

çº¿ç¨‹åˆ‡æ¢ï¼š
æ“ä½œç³»ç»Ÿå¼ºåˆ¶åˆ‡æ¢ â†’ ä¿å­˜æ‰€æœ‰å¯„å­˜å™¨ â†’ åˆ‡æ¢å†…å­˜æ˜ å°„ â†’ æ¢å¤å¯„å­˜å™¨
å¼€é”€ï¼šå¾®ç§’çº§

åç¨‹åˆ‡æ¢ï¼š  
ç¨‹åºä¸»åŠ¨è®©å‡º â†’ åªä¿å­˜å¿…è¦çŠ¶æ€ â†’ åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåç¨‹
å¼€é”€ï¼šçº³ç§’çº§
```

**ğŸ”§ åç¨‹ç¤ºä¾‹(Python)**
```python
import asyncio

async def cook_soup():
    """ç…®æ±¤ï¼šéœ€è¦ç­‰å¾…"""
    print("å¼€å§‹ç…®æ±¤...")
    await asyncio.sleep(3)  # ç­‰å¾…3ç§’ï¼Œè®©å‡ºæ§åˆ¶æƒ
    print("æ±¤ç…®å¥½äº†ï¼")

async def fry_egg():
    """ç…è›‹ï¼šéœ€è¦ç­‰å¾…"""
    print("å¼€å§‹ç…è›‹...")
    await asyncio.sleep(2)  # ç­‰å¾…2ç§’ï¼Œè®©å‡ºæ§åˆ¶æƒ
    print("è›‹ç…å¥½äº†ï¼")

async def cook_meal():
    """åŒæ—¶åšé¥­"""
    # å¹¶å‘æ‰§è¡Œï¼Œæ€»å…±åªéœ€è¦3ç§’
    await asyncio.gather(cook_soup(), fry_egg())
    print("é¥­èœéƒ½å¥½äº†ï¼")

# è¿è¡Œ
asyncio.run(cook_meal())
```

### 2.4 çº¤ç¨‹(Fiber)


**ğŸ§¶ çº¤ç¨‹çš„æœ¬è´¨**
> çº¤ç¨‹æ˜¯**ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹**ï¼Œå°±åƒçº¿ç¨‹çš„"è¿·ä½ ç‰ˆ"ã€‚å®ƒæ¯”åç¨‹æ›´åƒä¼ ç»Ÿçº¿ç¨‹ï¼Œä½†æ¯”çœŸæ­£çš„çº¿ç¨‹æ›´è½»é‡ã€‚

**ğŸ’¡ çº¤ç¨‹ç‰¹ç‚¹**
- **ç”¨æˆ·æ€è°ƒåº¦**ï¼šä¸éœ€è¦æ“ä½œç³»ç»Ÿå‚ä¸
- **ç‹¬ç«‹æ ˆç©ºé—´**ï¼šæ¯ä¸ªçº¤ç¨‹æœ‰è‡ªå·±çš„æ ˆ
- **æŠ¢å å¼è°ƒåº¦**ï¼šå¯ä»¥è¢«å¼ºåˆ¶åˆ‡æ¢(ä¸åƒåç¨‹éœ€è¦ä¸»åŠ¨è®©å‡º)
- **è½»é‡çº§**ï¼šæ¯”çº¿ç¨‹è½»é‡ï¼Œæ¯”åç¨‹é‡ä¸€äº›

---

## 3. ğŸ”„ å…±äº«èµ„æºä¸é€šä¿¡æ¨¡å¼


### 3.1 å…±äº«å†…å­˜æ¨¡å¼


**ğŸ  å…±äº«å†…å­˜é€šä¿—ç†è§£**
> å°±åƒ**å®¤å‹å…±ç”¨ä¸€ä¸ªå†°ç®±**ï¼Œå¤§å®¶éƒ½å¯ä»¥å¾€é‡Œé¢æ”¾ä¸œè¥¿ã€å–ä¸œè¥¿ã€‚ä½†å¦‚æœæ²¡æœ‰è§„åˆ™ï¼Œå¯èƒ½ä¼šå‡ºç°"ä½ ä»¥ä¸ºæœ‰ç‰›å¥¶ï¼Œç»“æœè¢«å®¤å‹å–å®Œäº†"çš„é—®é¢˜ã€‚

**âš ï¸ å…±äº«å†…å­˜çš„é—®é¢˜**
```java
// é—®é¢˜ç¤ºä¾‹ï¼šé“¶è¡Œè´¦æˆ·ä½™é¢
class BankAccount {
    private int balance = 1000;
    
    // å±é™©çš„å–é’±æ–¹æ³•
    public void withdraw(int amount) {
        if (balance >= amount) {        // 1. æ£€æŸ¥ä½™é¢
            // è¿™é‡Œå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼
            balance = balance - amount;  // 2. æ‰£å‡ä½™é¢
            System.out.println("å–å‡º " + amount + "ï¼Œä½™é¢ï¼š" + balance);
        }
    }
}

// ä¸¤ä¸ªäººåŒæ—¶å–é’±çš„é—®é¢˜ï¼š
// çº¿ç¨‹Aï¼šæ£€æŸ¥ä½™é¢1000 >= 800 âœ“
// çº¿ç¨‹Bï¼šæ£€æŸ¥ä½™é¢1000 >= 500 âœ“  
// çº¿ç¨‹Aï¼šä½™é¢ = 1000 - 800 = 200
// çº¿ç¨‹Bï¼šä½™é¢ = 1000 - 500 = 500 (é”™è¯¯ï¼åº”è¯¥æ˜¯-300)
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆï¼šåŒæ­¥æœºåˆ¶**
```java
// æ­£ç¡®çš„å–é’±æ–¹æ³•
public synchronized void withdraw(int amount) {
    if (balance >= amount) {
        balance = balance - amount;
        System.out.println("å–å‡º " + amount + "ï¼Œä½™é¢ï¼š" + balance);
    } else {
        System.out.println("ä½™é¢ä¸è¶³");
    }
}
```

### 3.2 æ¶ˆæ¯ä¼ é€’æ¨¡å¼


**ğŸ“® æ¶ˆæ¯ä¼ é€’é€šä¿—ç†è§£**
> å°±åƒ**é‚®é€’å‘˜é€ä¿¡**ï¼Œä¸åŒçš„äººä½åœ¨ä¸åŒçš„æˆ¿å­é‡Œï¼Œæƒ³è¦æ²Ÿé€šå°±å†™ä¿¡é€šè¿‡é‚®é€’å‘˜ä¼ é€’ã€‚æ¯ä¸ªäººçš„æˆ¿å­æ˜¯ç§äººçš„ï¼Œä¸ä¼šè¢«åˆ«äººä¹±åŠ¨ã€‚

**ğŸ¯ æ¶ˆæ¯ä¼ é€’ä¼˜åŠ¿**
- **æ— å…±äº«çŠ¶æ€**ï¼šé¿å…ç«äº‰æ¡ä»¶
- **ä½ç½®é€æ˜**ï¼šå‘é€è€…ä¸éœ€è¦çŸ¥é“æ¥æ”¶è€…åœ¨å“ªé‡Œ
- **å®¹é”™æ€§å¥½**ï¼šä¸€ä¸ªç»„ä»¶å´©æºƒä¸å½±å“å…¶ä»–ç»„ä»¶

**ğŸ”§ æ¶ˆæ¯ä¼ é€’ç¤ºä¾‹**
```java
// ä½¿ç”¨é˜»å¡é˜Ÿåˆ—å®ç°æ¶ˆæ¯ä¼ é€’
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.LinkedBlockingQueue;

class MessagePasser {
    private BlockingQueue<String> messageQueue = new LinkedBlockingQueue<>();
    
    // å‘é€æ¶ˆæ¯
    public void sendMessage(String message) {
        try {
            messageQueue.put(message); // æ”¾å…¥æ¶ˆæ¯
            System.out.println("å‘é€æ¶ˆæ¯ï¼š" + message);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    // æ¥æ”¶æ¶ˆæ¯
    public String receiveMessage() {
        try {
            String message = messageQueue.take(); // å–å‡ºæ¶ˆæ¯
            System.out.println("æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
            return message;
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            return null;
        }
    }
}
```

**ğŸ“Š ä¸¤ç§æ¨¡å¼å¯¹æ¯”**

| **æ–¹é¢** | **å…±äº«å†…å­˜** | **æ¶ˆæ¯ä¼ é€’** |
|---------|-------------|-------------|
| **é€šä¿¡æ–¹å¼** | `ç›´æ¥è®¿é—®å…±äº«å˜é‡` | `å‘é€/æ¥æ”¶æ¶ˆæ¯` |
| **åŒæ­¥å¤æ‚åº¦** | `éœ€è¦é”å’ŒåŒæ­¥æœºåˆ¶` | `å¤©ç„¶é¿å…ç«äº‰æ¡ä»¶` |
| **æ€§èƒ½** | `è®¿é—®é€Ÿåº¦å¿«` | `æœ‰æ¶ˆæ¯æ‹·è´å¼€é”€` |
| **è°ƒè¯•éš¾åº¦** | `ç«äº‰æ¡ä»¶éš¾è°ƒè¯•` | `æ¶ˆæ¯æµç¨‹æ¸…æ™°` |
| **æ‰©å±•æ€§** | `å•æœºé™åˆ¶` | `å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼` |

---

## 4. ğŸ” é”æœºåˆ¶ä¸åŒæ­¥é—®é¢˜


### 4.1 é”æœºåˆ¶è¯¦è§£


**ğŸ”’ é”çš„é€šä¿—ç†è§£**
> é”å°±åƒ**å«ç”Ÿé—´çš„é—¨é”**ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªäººä½¿ç”¨ã€‚å…¶ä»–äººå¿…é¡»åœ¨å¤–é¢ç­‰å¾…ï¼Œç›´åˆ°é‡Œé¢çš„äººå‡ºæ¥å¹¶è§£é”ã€‚

**ğŸ› ï¸ åŸºæœ¬é”ç±»å‹**

```java
// 1. synchronizedå…³é”®å­—ï¼ˆJavaå†…ç½®é”ï¼‰
class Counter {
    private int count = 0;
    
    // æ–¹æ³•çº§åˆ«çš„é”
    public synchronized void increment() {
        count++; // è¿™é‡Œæ˜¯çº¿ç¨‹å®‰å…¨çš„
    }
    
    // ä»£ç å—çº§åˆ«çš„é”
    public void decrement() {
        synchronized(this) {
            count--; // åªé”å®šè¿™ä¸€éƒ¨åˆ†ä»£ç 
        }
    }
    
    public synchronized int getValue() {
        return count;
    }
}
```

**âš¡ é”çš„æ€§èƒ½è€ƒè™‘**
```
é”çš„å¼€é”€ï¼š

è·å–é” â†’ æ‰§è¡Œä¸´ç•ŒåŒºä»£ç  â†’ é‡Šæ”¾é”
  â†“           â†“              â†“
 ç­‰å¾…æ—¶é—´   å®é™…å·¥ä½œæ—¶é—´    é‡Šæ”¾å¼€é”€

ä¼˜åŒ–åŸåˆ™ï¼š
â€¢ ä¸´ç•ŒåŒºè¶Šå°è¶Šå¥½
â€¢ é”çš„ç²’åº¦è¦åˆé€‚  
â€¢ é¿å…ä¸å¿…è¦çš„é”
```

### 4.2 æ­»é”(Deadlock)


**ğŸ’€ æ­»é”é€šä¿—ç†è§£**
> æ­»é”å°±åƒ**ä¸¤ä¸ªäººè¿‡ç‹¬æœ¨æ¡¥**ï¼Œéƒ½ä¸è‚¯è®©æ­¥ã€‚Aè¯´"ä½ å…ˆé€€å›å»ï¼Œæˆ‘å°±è¿‡å»"ï¼ŒBä¹Ÿè¯´"ä½ å…ˆé€€å›å»ï¼Œæˆ‘å°±è¿‡å»"ã€‚ç»“æœè°ä¹Ÿè¿‡ä¸å»ï¼Œæ°¸è¿œåƒµæŒã€‚

**ğŸ”§ æ­»é”ç¤ºä¾‹**
```java
class DeadlockDemo {
    private final Object lock1 = new Object();
    private final Object lock2 = new Object();
    
    public void method1() {
        synchronized(lock1) {           // è·å–é”1
            System.out.println("çº¿ç¨‹1ï¼šè·å¾—lock1");
            try { Thread.sleep(100); } catch(InterruptedException e) {}
            
            synchronized(lock2) {       // è¯•å›¾è·å–é”2
                System.out.println("çº¿ç¨‹1ï¼šè·å¾—lock2");
            }
        }
    }
    
    public void method2() {
        synchronized(lock2) {           // è·å–é”2  
            System.out.println("çº¿ç¨‹2ï¼šè·å¾—lock2");
            try { Thread.sleep(100); } catch(InterruptedException e) {}
            
            synchronized(lock1) {       // è¯•å›¾è·å–é”1
                System.out.println("çº¿ç¨‹2ï¼šè·å¾—lock1");
            }
        }
    }
}

// è¿è¡Œç»“æœï¼šä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç¨‹åºå¡æ­»
```

**ğŸ›¡ï¸ é¿å…æ­»é”çš„æ–¹æ³•**
```
æ­»é”é¢„é˜²å››åŸåˆ™ï¼š

1. ç»Ÿä¸€åŠ é”é¡ºåº
   æ‰€æœ‰çº¿ç¨‹éƒ½æŒ‰ç›¸åŒé¡ºåºè·å–é”

2. è®¾ç½®è¶…æ—¶æ—¶é—´
   è·å–é”æ—¶è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´

3. æ£€æµ‹ä¸è§£å†³
   å®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰æ­»é”ï¼Œå¼ºåˆ¶æ‰“ç ´

4. é¿å…åµŒå¥—é”
   å°½é‡ä¸è¦åœ¨æŒæœ‰ä¸€ä¸ªé”æ—¶å»è·å–å¦ä¸€ä¸ªé”
```

### 4.3 é¥¥é¥¿(Starvation)ä¸æ´»é”(Livelock)


**ğŸ½ï¸ é¥¥é¥¿é—®é¢˜**
> é¥¥é¥¿å°±åƒ**é£Ÿå ‚æ’é˜Ÿ**ï¼Œå¦‚æœæ€»æ˜¯æœ‰äººæ’é˜Ÿï¼Œæ’åœ¨åé¢çš„äººå¯èƒ½æ°¸è¿œåƒä¸åˆ°é¥­ã€‚

```java
// é¥¥é¥¿ç¤ºä¾‹ï¼šä¼˜å…ˆçº§é—®é¢˜
class StarvationDemo {
    public void highPriorityTask() {
        // é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¸æ–­æ‰§è¡Œ
        while(true) {
            synchronized(this) {
                System.out.println("é«˜ä¼˜å…ˆçº§ä»»åŠ¡æ‰§è¡Œ");
                // æ‰§è¡Œå®Œç«‹å³å†æ¬¡è·å–é”
            }
        }
    }
    
    public void lowPriorityTask() {
        // ä½ä¼˜å…ˆçº§ä»»åŠ¡å¯èƒ½æ°¸è¿œå¾—ä¸åˆ°æ‰§è¡Œæœºä¼š
        synchronized(this) {
            System.out.println("ä½ä¼˜å…ˆçº§ä»»åŠ¡æ‰§è¡Œ");
        }
    }
}
```

**ğŸ”„ æ´»é”é—®é¢˜**
> æ´»é”å°±åƒ**ä¸¤ä¸ªç¤¼è²Œçš„äººåœ¨èµ°å»Šç›¸é‡**ï¼Œéƒ½æƒ³è®©å¯¹æ–¹å…ˆè¿‡ï¼Œç»“æœåŒæ—¶å‘å·¦è®©ï¼ŒåˆåŒæ—¶å‘å³è®©ï¼Œè°ä¹Ÿè¿‡ä¸å»ã€‚

```java
// æ´»é”ç¤ºä¾‹ï¼šè¿‡åº¦ç¤¼è®©
class LivelockDemo {
    private boolean flag1 = true;
    private boolean flag2 = true;
    
    public void worker1() {
        while(flag1) {
            if(flag2) {
                System.out.println("å·¥äºº1ï¼šè®©å·¥äºº2å…ˆæ‰§è¡Œ");
                Thread.yield(); // ç¤¼è®©
                continue;
            }
            // æ‰§è¡Œå®é™…å·¥ä½œ
            System.out.println("å·¥äºº1ï¼šæ‰§è¡Œå·¥ä½œ");
            flag1 = false;
        }
    }
    
    public void worker2() {
        while(flag2) {
            if(flag1) {
                System.out.println("å·¥äºº2ï¼šè®©å·¥äºº1å…ˆæ‰§è¡Œ");  
                Thread.yield(); // ç¤¼è®©
                continue;
            }
            // æ‰§è¡Œå®é™…å·¥ä½œ
            System.out.println("å·¥äºº2ï¼šæ‰§è¡Œå·¥ä½œ");
            flag2 = false;
        }
    }
}
```

---

## 5. âš›ï¸ åŸå­æ“ä½œä¸å†…å­˜ä¸€è‡´æ€§


### 5.1 åŸå­æ“ä½œ(Atomic Operations)


**âš›ï¸ åŸå­æ“ä½œé€šä¿—ç†è§£**
> åŸå­æ“ä½œå°±åƒ**ä¸å¯åˆ†å‰²çš„åŸå­**ï¼Œè¦ä¹ˆå®Œå…¨å‘ç”Ÿï¼Œè¦ä¹ˆå®Œå…¨ä¸å‘ç”Ÿï¼Œç»ä¸ä¼šè¢«ä¸­é€”æ‰“æ–­ã€‚å°±åƒå¼€å…³ç¯ï¼Œä¸å­˜åœ¨"åŠå¼€"çŠ¶æ€ã€‚

**ğŸ”§ åŸå­æ“ä½œç¤ºä¾‹**
```java
import java.util.concurrent.atomic.AtomicInteger;

class AtomicCounter {
    private AtomicInteger count = new AtomicInteger(0);
    
    // åŸå­æ€§çš„å¢åŠ æ“ä½œ
    public void increment() {
        count.incrementAndGet(); // è¿™æ˜¯åŸå­æ“ä½œï¼Œä¸ä¼šè¢«ä¸­æ–­
    }
    
    // åŸå­æ€§çš„æ¯”è¾ƒå¹¶äº¤æ¢
    public boolean compareAndSet(int expected, int newValue) {
        return count.compareAndSet(expected, newValue);
    }
    
    public int getValue() {
        return count.get(); // åŸå­è¯»å–
    }
}

// å¯¹æ¯”æ™®é€šçš„éåŸå­æ“ä½œ
class NonAtomicCounter {
    private int count = 0;
    
    // éåŸå­æ“ä½œï¼šå¯èƒ½è¢«ä¸­æ–­
    public void increment() {
        count++; // å®é™…åˆ†ä¸ºä¸‰æ­¥ï¼šè¯»å–ã€åŠ 1ã€å†™å›
    }
}
```

### 5.2 CASæœºåˆ¶


**ğŸ”„ CASé€šä¿—ç†è§£**
> CASå°±åƒ**ç½‘è´­æŠ¢è´­**ï¼šä½ çœ‹åˆ°å•†å“ä»·æ ¼æ˜¯100å…ƒï¼Œç‚¹å‡»è´­ä¹°æ—¶ç³»ç»Ÿæ£€æŸ¥"ä»·æ ¼è¿˜æ˜¯100å…ƒå—ï¼Ÿ"å¦‚æœæ˜¯ï¼Œå°±æˆåŠŸè´­ä¹°ï¼›å¦‚æœä»·æ ¼å˜äº†ï¼Œå°±è´­ä¹°å¤±è´¥ï¼Œä½ éœ€è¦é‡æ–°å°è¯•ã€‚

**ğŸ’¡ CASå·¥ä½œåŸç†**
```
CASæ“ä½œæµç¨‹ï¼š

æ¯”è¾ƒ(Compare) â†’ åˆ¤æ–­(And) â†’ äº¤æ¢(Swap)
     â†“              â†“           â†“
 å½“å‰å€¼=æœŸæœ›å€¼?   â†’ æ˜¯ â†’ æ›´æ–°ä¸ºæ–°å€¼
     â†“              â†“           â†“  
     å¦ â†’ æ“ä½œå¤±è´¥ â†’ é‡æ–°å°è¯•æˆ–è¿”å›å¤±è´¥
```

**ğŸ”§ CASå®ç°ç¤ºä¾‹**
```java
class CASDemo {
    private volatile int value = 0;
    
    // æ¨¡æ‹ŸCASæ“ä½œçš„é€»è¾‘
    public boolean compareAndSwap(int expected, int newValue) {
        // 1. æ¯”è¾ƒå½“å‰å€¼å’ŒæœŸæœ›å€¼
        if (value == expected) {
            // 2. å¦‚æœç›¸ç­‰ï¼Œæ›´æ–°ä¸ºæ–°å€¼
            value = newValue;
            return true; // æˆåŠŸ
        }
        // 3. å¦‚æœä¸ç›¸ç­‰ï¼Œæ“ä½œå¤±è´¥
        return false;
    }
    
    // ä½¿ç”¨CASå®ç°æ— é”çš„é€’å¢
    public void incrementWithCAS() {
        int current;
        int next;
        do {
            current = value;           // è¯»å–å½“å‰å€¼
            next = current + 1;       // è®¡ç®—æ–°å€¼
        } while (!compareAndSwap(current, next)); // é‡è¯•ç›´åˆ°æˆåŠŸ
    }
}
```

### 5.3 å†…å­˜ä¸€è‡´æ€§


**ğŸ§  å†…å­˜ä¸€è‡´æ€§é€šä¿—ç†è§£**
> å†…å­˜ä¸€è‡´æ€§å°±åƒ**å›¢é˜Ÿæ¶ˆæ¯åŒæ­¥**ï¼šå½“è€æ¿å‘å¸ƒæ–°é€šçŸ¥æ—¶ï¼Œéœ€è¦ç¡®ä¿æ‰€æœ‰å‘˜å·¥éƒ½èƒ½åŠæ—¶çœ‹åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æœ‰äººè¿˜åœ¨çœ‹æ—§é€šçŸ¥ã€‚

**âš¡ volatileå…³é”®å­—**
```java
class VisibilityDemo {
    private volatile boolean flag = false; // volatileç¡®ä¿å¯è§æ€§
    private int normalVar = 0;             // æ™®é€šå˜é‡
    
    // çº¿ç¨‹1ï¼šä¿®æ”¹å˜é‡
    public void writer() {
        normalVar = 42;    // 1. ä¿®æ”¹æ™®é€šå˜é‡
        flag = true;       // 2. ä¿®æ”¹volatileå˜é‡
    }
    
    // çº¿ç¨‹2ï¼šè¯»å–å˜é‡
    public void reader() {
        if (flag) {        // 3. è¯»å–volatileå˜é‡
            // å› ä¸ºvolatileçš„å†…å­˜å±éšœæ•ˆæœ
            // è¿™é‡Œèƒ½çœ‹åˆ°normalVarçš„æœ€æ–°å€¼42
            System.out.println("normalVar = " + normalVar);
        }
    }
}
```

**ğŸ“Š å†…å­˜ä¸€è‡´æ€§æ¨¡å‹**
```
Javaå†…å­˜æ¨¡å‹(JMM)ï¼š

æ¯ä¸ªçº¿ç¨‹çš„å·¥ä½œå†…å­˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   çº¿ç¨‹1     â”‚    â”‚   çº¿ç¨‹2     â”‚    â”‚   çº¿ç¨‹3     â”‚
â”‚  å·¥ä½œå†…å­˜   â”‚    â”‚  å·¥ä½œå†…å­˜   â”‚    â”‚  å·¥ä½œå†…å­˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†•                 â†•                 â†•
    read/write        read/write        read/write
       â†•                 â†•                 â†•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                  ä¸»å†…å­˜                              â”‚
â”‚           (æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å˜é‡å­˜å‚¨åŒºåŸŸ)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼šå·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬å¯èƒ½ä¸æ˜¯æœ€æ–°çš„
è§£å†³ï¼švolatileã€synchronizedã€finalç­‰ä¿è¯ä¸€è‡´æ€§
```

---

## 6. ğŸ† å¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ


### 6.1 çº¿ç¨‹å®‰å…¨å®ˆåˆ™


**ğŸ›¡ï¸ çº¿ç¨‹å®‰å…¨åŸºæœ¬åŸåˆ™**

```
çº¿ç¨‹å®‰å…¨å››è¦ç´ ï¼š

åŸå­æ€§(Atomicity)ï¼š
â€¢ æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆ
â€¢ ä½¿ç”¨ï¼šsynchronizedã€AtomicXXXã€CAS

å¯è§æ€§(Visibility)ï¼š
â€¢ ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§
â€¢ ä½¿ç”¨ï¼švolatileã€synchronizedã€final

æœ‰åºæ€§(Ordering)ï¼š
â€¢ ç¨‹åºæ‰§è¡Œé¡ºåºç¬¦åˆé¢„æœŸ
â€¢ ä½¿ç”¨ï¼švolatileã€synchronizedã€å†…å­˜å±éšœ

ä¸€è‡´æ€§(Consistency)ï¼š
â€¢ ç³»ç»ŸçŠ¶æ€å§‹ç»ˆä¿æŒä¸€è‡´
â€¢ è®¾è®¡ï¼šä¸å˜å¼ã€çŠ¶æ€è½¬æ¢è§„åˆ™
```

**ğŸ”§ çº¿ç¨‹å®‰å…¨å®ç°ç¤ºä¾‹**
```java
class ThreadSafeCounter {
    private volatile int count = 0;           // ä¿è¯å¯è§æ€§
    private final Object lock = new Object(); // é”å¯¹è±¡
    
    // ä½¿ç”¨é”ä¿è¯åŸå­æ€§
    public void increment() {
        synchronized(lock) {
            count++; // åŸå­æ€§æ“ä½œ
        }
    }
    
    // åªè¯»æ“ä½œï¼Œvolatileä¿è¯å¯è§æ€§
    public int getCount() {
        return count;
    }
    
    // å¤åˆæ“ä½œéœ€è¦å®Œå…¨åŒæ­¥
    public void incrementIfLessThan(int max) {
        synchronized(lock) {
            if (count < max) {
                count++;
            }
        }
    }
}
```

### 6.2 ç«äº‰æ¡ä»¶çš„é¿å…


**ğŸƒ ç«äº‰æ¡ä»¶é€šä¿—ç†è§£**
> ç«äº‰æ¡ä»¶å°±åƒ**ä¸¤ä¸ªäººåŒæ—¶ç¼–è¾‘ä¸€ä¸ªæ–‡æ¡£**ï¼Œå¦‚æœæ²¡æœ‰åè°ƒæœºåˆ¶ï¼Œæœ€åçš„ç»“æœå¯èƒ½æ˜¯ä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œæˆ–è€…æœ‰äººçš„ä¿®æ”¹è¢«è¦†ç›–äº†ã€‚

**âš ï¸ å¸¸è§ç«äº‰æ¡ä»¶**
```java
// å±é™©ç¤ºä¾‹ï¼šæ£€æŸ¥å†æ‰§è¡Œ
class UnsafeOperation {
    private Map<String, Integer> inventory = new HashMap<>();
    
    // ä¸å®‰å…¨çš„åº“å­˜æ£€æŸ¥å’Œå‡å°‘
    public boolean sellProduct(String product, int quantity) {
        Integer current = inventory.get(product);
        if (current != null && current >= quantity) {  // æ£€æŸ¥
            // è¿™é‡Œå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼
            inventory.put(product, current - quantity); // æ‰§è¡Œ
            return true;
        }
        return false;
    }
}

// å®‰å…¨ç¤ºä¾‹ï¼šåŸå­æ“ä½œ
class SafeOperation {
    private Map<String, AtomicInteger> inventory = new ConcurrentHashMap<>();
    
    public boolean sellProduct(String product, int quantity) {
        AtomicInteger current = inventory.get(product);
        if (current != null) {
            // åŸå­æ€§çš„æ¯”è¾ƒå¹¶å‡å°‘
            while (true) {
                int currentValue = current.get();
                if (currentValue < quantity) {
                    return false; // åº“å­˜ä¸è¶³
                }
                if (current.compareAndSet(currentValue, currentValue - quantity)) {
                    return true; // æˆåŠŸå‡å°‘åº“å­˜
                }
                // CASå¤±è´¥ï¼Œé‡è¯•
            }
        }
        return false;
    }
}
```

### 6.3 æœ€å°å…±äº«åŸåˆ™


**ğŸ¤ æœ€å°å…±äº«é€šä¿—ç†è§£**
> æœ€å°å…±äº«å°±åƒ**å®¿èˆç®¡ç†**ï¼šä¸å…¶è®©æ‰€æœ‰äººå…±ç”¨ä¸€ä¸ªå¤§å†°ç®±(å®¹æ˜“æ··ä¹±)ï¼Œä¸å¦‚æ¯ä¸ªäººæœ‰è‡ªå·±çš„å°å†°ç®±ï¼Œåªåœ¨å¿…è¦æ—¶æ‰å…±äº«å…¬å…±åŒºåŸŸã€‚

**ğŸ’¡ å®ç°ç­–ç•¥**

```java
// ä¸å¥½çš„è®¾è®¡ï¼šå¤§é‡å…±äº«çŠ¶æ€
class BadDesign {
    private static int globalCounter = 0;      // å…¨å±€å…±äº«
    private static List<String> sharedList = new ArrayList<>(); // å…±äº«é›†åˆ
    private static Map<String, Object> cache = new HashMap<>(); // å…±äº«ç¼“å­˜
    
    // æ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦åŒæ­¥ï¼Œæ€§èƒ½å·®
    public synchronized void doWork() {
        globalCounter++;
        sharedList.add("item");
        cache.put("key", "value");
    }
}

// å¥½çš„è®¾è®¡ï¼šæœ€å°åŒ–å…±äº«
class GoodDesign {
    // åªå…±äº«çœŸæ­£éœ€è¦å…±äº«çš„æ•°æ®
    private final AtomicInteger essentialCounter = new AtomicInteger(0);
    
    public void doWork() {
        // ä½¿ç”¨å±€éƒ¨å˜é‡ï¼Œæ— éœ€åŒæ­¥
        List<String> localList = new ArrayList<>();
        Map<String, Object> localCache = new HashMap<>();
        
        // æœ¬åœ°å¤„ç†
        localList.add("item");
        localCache.put("key", "value");
        
        // åªåœ¨å¿…è¦æ—¶æ›´æ–°å…±äº«çŠ¶æ€
        essentialCounter.incrementAndGet();
        
        // è¿”å›ç»“æœè€Œä¸æ˜¯ä¿®æ”¹å…±äº«çŠ¶æ€
        processLocally(localList, localCache);
    }
    
    private void processLocally(List<String> list, Map<String, Object> cache) {
        // å¤„ç†é€»è¾‘...
    }
}
```

### 6.4 ä¸å˜å¼ä¸è¶…æ—¶é‡è¯•


**ğŸ”’ ä¸å˜å¼(Invariants)**
> ä¸å˜å¼å°±åƒ**é“¶è¡Œçš„åŸºæœ¬è§„åˆ™**ï¼š"æ‰€æœ‰è´¦æˆ·ä½™é¢ä¹‹å’Œç­‰äºé“¶è¡Œæ€»èµ„äº§"ã€‚æ— è®ºè¿›è¡Œå¤šå°‘è½¬è´¦æ“ä½œï¼Œè¿™ä¸ªè§„åˆ™éƒ½ä¸èƒ½è¢«ç ´åã€‚

```java
class BankTransfer {
    private final Map<String, AtomicLong> accounts = new ConcurrentHashMap<>();
    
    // ä¸å˜å¼ï¼šè½¬è´¦å‰åæ€»é‡‘é¢ä¸å˜
    public boolean transfer(String from, String to, long amount) {
        AtomicLong fromAccount = accounts.get(from);
        AtomicLong toAccount = accounts.get(to);
        
        if (fromAccount == null || toAccount == null) {
            return false;
        }
        
        // ä¿è¯åŸå­æ€§ï¼šè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥
        long fromBalance = fromAccount.get();
        if (fromBalance < amount) {
            return false; // ä½™é¢ä¸è¶³
        }
        
        // ä½¿ç”¨CASç¡®ä¿åŸå­æ€§
        if (fromAccount.compareAndSet(fromBalance, fromBalance - amount)) {
            toAccount.addAndGet(amount);
            return true;
        }
        
        return false; // è½¬è´¦å¤±è´¥ï¼Œéœ€è¦é‡è¯•
    }
}
```

**â° è¶…æ—¶ä¸é‡è¯•æœºåˆ¶**
```java
class RetryMechanism {
    private final int MAX_RETRIES = 3;
    private final long TIMEOUT_MS = 5000;
    
    public boolean executeWithRetry(Runnable task) {
        for (int attempt = 1; attempt <= MAX_RETRIES; attempt++) {
            try {
                long startTime = System.currentTimeMillis();
                
                // æ‰§è¡Œä»»åŠ¡
                task.run();
                
                // æ£€æŸ¥è¶…æ—¶
                if (System.currentTimeMillis() - startTime > TIMEOUT_MS) {
                    System.out.println("ç¬¬" + attempt + "æ¬¡å°è¯•è¶…æ—¶");
                    continue;
                }
                
                return true; // æˆåŠŸ
                
            } catch (Exception e) {
                System.out.println("ç¬¬" + attempt + "æ¬¡å°è¯•å¤±è´¥: " + e.getMessage());
                
                if (attempt == MAX_RETRIES) {
                    System.out.println("æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥äº†");
                    return false;
                }
                
                // æŒ‡æ•°é€€é¿ï¼šç­‰å¾…æ—¶é—´é€æ¸å¢åŠ 
                try {
                    Thread.sleep(1000 * attempt);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    return false;
                }
            }
        }
        return false;
    }
}
```

### 6.5 å¹‚ç­‰æ€§è®¾è®¡


**ğŸ”„ å¹‚ç­‰æ€§é€šä¿—ç†è§£**
> å¹‚ç­‰æ€§å°±åƒ**ç”µç¯å¼€å…³**ï¼šä¸ç®¡ä½ æŒ‰å¤šå°‘æ¬¡"å¼€"ï¼Œç¯è¿˜æ˜¯å¼€ç€çš„çŠ¶æ€ï¼›ä¸ç®¡æŒ‰å¤šå°‘æ¬¡"å…³"ï¼Œç¯è¿˜æ˜¯å…³ç€çš„çŠ¶æ€ã€‚å¤šæ¬¡æ‰§è¡Œç›¸åŒæ“ä½œçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚

```java
class IdempotentOperations {
    private final Set<String> processedIds = ConcurrentHashMap.newKeySet();
    private final Map<String, String> results = new ConcurrentHashMap<>();
    
    // å¹‚ç­‰çš„è®¢å•å¤„ç†
    public String processOrder(String orderId, String orderData) {
        // æ£€æŸ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡
        if (processedIds.contains(orderId)) {
            return results.get(orderId); // è¿”å›ä¹‹å‰çš„ç»“æœ
        }
        
        // æ‰§è¡Œå®é™…å¤„ç†é€»è¾‘
        String result = doActualProcessing(orderData);
        
        // è®°å½•å¤„ç†ç»“æœ
        processedIds.add(orderId);
        results.put(orderId, result);
        
        return result;
    }
    
    private String doActualProcessing(String orderData) {
        // å®é™…çš„ä¸šåŠ¡å¤„ç†é€»è¾‘
        return "processed-" + orderData;
    }
}
```

---

## 7. ğŸŒŸ ç°ä»£å¹¶å‘æ¨¡å‹


### 7.1 åç¨‹çš„æ·±å…¥åº”ç”¨


**ğŸ­ åç¨‹ç¼–ç¨‹æ¨¡å‹**
> åç¨‹è®©æˆ‘ä»¬å¯ä»¥å†™**çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç çš„å¼‚æ­¥ç¨‹åº**ï¼Œå°±åƒå†™æ™®é€šçš„é¡ºåºç¨‹åºï¼Œä½†å®é™…ä¸Šæ˜¯é«˜æ•ˆçš„å¹¶å‘ç¨‹åºã€‚

```python
# Pythonåç¨‹ç¤ºä¾‹ï¼šç½‘ç»œè¯·æ±‚
import asyncio
import aiohttp

async def fetch_url(session, url):
    """å¼‚æ­¥è·å–URLå†…å®¹"""
    try:
        async with session.get(url) as response:
            content = await response.text()
            return f"{url}: {len(content)} å­—ç¬¦"
    except Exception as e:
        return f"{url}: é”™è¯¯ {e}"

async def fetch_multiple_urls(urls):
    """å¹¶å‘è·å–å¤šä¸ªURL"""
    async with aiohttp.ClientSession() as session:
        # åˆ›å»ºåç¨‹ä»»åŠ¡
        tasks = [fetch_url(session, url) for url in urls]
        
        # å¹¶å‘æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
        results = await asyncio.gather(*tasks)
        return results

# ä½¿ç”¨ç¤ºä¾‹
urls = [
    "https://httpbin.org/delay/1",
    "https://httpbin.org/delay/2", 
    "https://httpbin.org/delay/3"
]

# ä¸²è¡Œæ‰§è¡Œéœ€è¦6ç§’ï¼Œå¹¶å‘æ‰§è¡Œåªéœ€è¦3ç§’
results = asyncio.run(fetch_multiple_urls(urls))
```

### 7.2 çº¤ç¨‹çš„å®é™…åº”ç”¨


**ğŸ§¶ çº¤ç¨‹ç¼–ç¨‹æ¨¡å‹**
> çº¤ç¨‹åœ¨æŸäº›è¯­è¨€ä¸­æä¾›äº†æ›´æ¥è¿‘ä¼ ç»Ÿçº¿ç¨‹çš„ç¼–ç¨‹ä½“éªŒï¼Œä½†æ€§èƒ½æ›´å¥½ã€‚

```go
// Goè¯­è¨€çš„goroutineï¼ˆç±»ä¼¼çº¤ç¨‹ï¼‰
package main

import (
    "fmt"
    "sync"
    "time"
)

func worker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    
    for i := 0; i < 5; i++ {
        fmt.Printf("å·¥äºº %d æ‰§è¡Œä»»åŠ¡ %d\n", id, i)
        time.Sleep(time.Second)
    }
}

func main() {
    var wg sync.WaitGroup
    
    // åˆ›å»º100ä¸ªgoroutineï¼ˆçº¤ç¨‹ï¼‰
    for i := 1; i <= 100; i++ {
        wg.Add(1)
        go worker(i, &wg) // å¯åŠ¨goroutine
    }
    
    wg.Wait() // ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ
    fmt.Println("æ‰€æœ‰å·¥ä½œå®Œæˆ")
}
```

### 7.3 å¤„ç†å¹¶è¡Œæ‰§è¡Œçš„ç¼–ç¨‹æ€ç»´


**ğŸ§  å¹¶å‘æ€ç»´æ¨¡å¼**

```
ä¸²è¡Œæ€ç»´ â†’ å¹¶å‘æ€ç»´çš„è½¬æ¢ï¼š

ä¸²è¡Œæ€ç»´ï¼š
ç¬¬1æ­¥ â†’ ç¬¬2æ­¥ â†’ ç¬¬3æ­¥ â†’ å®Œæˆ

å¹¶å‘æ€ç»´ï¼š
ç¬¬1æ­¥ â”
ç¬¬2æ­¥ â”œâ†’ æ±‡æ€» â†’ å®Œæˆ  
ç¬¬3æ­¥ â”˜

å…³é”®è½¬å˜ï¼š
â€¢ è¯†åˆ«å¯ä»¥å¹¶è¡Œçš„ä»»åŠ¡
â€¢ è®¾è®¡ä»»åŠ¡é—´çš„åè°ƒæœºåˆ¶
â€¢ å¤„ç†å¼‚å¸¸å’Œé”™è¯¯æƒ…å†µ
â€¢ åˆç†åˆ†é…å’Œç®¡ç†èµ„æº
```

**ğŸ”§ å¹¶å‘è®¾è®¡æ¨¡å¼**
```java
// ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼
class ProducerConsumerDemo {
    private final BlockingQueue<Integer> queue = new LinkedBlockingQueue<>(10);
    private final AtomicBoolean running = new AtomicBoolean(true);
    
    // ç”Ÿäº§è€…ï¼šäº§ç”Ÿæ•°æ®
    class Producer implements Runnable {
        @Override
        public void run() {
            int value = 0;
            while (running.get()) {
                try {
                    queue.put(value++); // æ”¾å…¥æ•°æ®
                    System.out.println("ç”Ÿäº§ï¼š" + value);
                    Thread.sleep(100);
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                    break;
                }
            }
        }
    }
    
    // æ¶ˆè´¹è€…ï¼šå¤„ç†æ•°æ®
    class Consumer implements Runnable {
        @Override
        public void run() {
            while (running.get()) {
                try {
                    Integer value = queue.take(); // å–å‡ºæ•°æ®
                    System.out.println("æ¶ˆè´¹ï¼š" + value);
                    Thread.sleep(200); // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                    break;
                }
            }
        }
    }
    
    public void start() {
        // å¯åŠ¨1ä¸ªç”Ÿäº§è€…å’Œ2ä¸ªæ¶ˆè´¹è€…
        new Thread(new Producer()).start();
        new Thread(new Consumer()).start();
        new Thread(new Consumer()).start();
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ‰§è¡Œå•å…ƒï¼šçº¿ç¨‹ã€è¿›ç¨‹ã€åç¨‹ã€çº¤ç¨‹çš„åŒºåˆ«ä¸é€‚ç”¨åœºæ™¯
ğŸ”¸ é€šä¿¡æ¨¡å¼ï¼šå…±äº«å†…å­˜vsæ¶ˆæ¯ä¼ é€’çš„ä¼˜ç¼ºç‚¹ä¸é€‰æ‹©
ğŸ”¸ åŒæ­¥æœºåˆ¶ï¼šé”ã€åŸå­æ“ä½œã€CASçš„ä½¿ç”¨åœºæ™¯
ğŸ”¸ å¹¶å‘é—®é¢˜ï¼šæ­»é”ã€é¥¥é¥¿ã€æ´»é”ã€ç«äº‰æ¡ä»¶çš„è¯†åˆ«ä¸è§£å†³
ğŸ”¸ å†…å­˜æ¨¡å‹ï¼šåŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ä¿è¯æœºåˆ¶
ğŸ”¸ è®¾è®¡åŸåˆ™ï¼šæœ€å°å…±äº«ã€ä¸å˜å¼ã€å¹‚ç­‰æ€§ã€è¶…æ—¶é‡è¯•
ğŸ”¸ ç°ä»£æ¨¡å‹ï¼šåç¨‹ç¼–ç¨‹ã€å¼‚æ­¥ç¼–ç¨‹çš„æ€ç»´è½¬æ¢
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¹¶å‘ vs å¹¶è¡Œçš„æœ¬è´¨åŒºåˆ«**
```
å¹¶å‘ï¼šå¤„ç†å¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›ï¼ˆç®¡ç†å¤æ‚æ€§ï¼‰
å¹¶è¡Œï¼šåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼ˆæå‡æ€§èƒ½ï¼‰
è®¾è®¡é‡ç‚¹ï¼šå¹¶å‘ä¸“æ³¨åè°ƒï¼Œå¹¶è¡Œä¸“æ³¨æ•ˆç‡
```

**ğŸ”¹ é”ä¸æ— é”çš„æƒè¡¡**
```
æœ‰é”ï¼šç®€å•å¯é ï¼Œä½†æ€§èƒ½æœ‰ç“¶é¢ˆ
æ— é”ï¼šæ€§èƒ½æ›´å¥½ï¼Œä½†å®ç°å¤æ‚
é€‰æ‹©åŸåˆ™ï¼šä¼˜å…ˆç®€å•å¯é ï¼Œæ€§èƒ½ç“¶é¢ˆæ—¶è€ƒè™‘æ— é”
```

**ğŸ”¹ å…±äº«çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒ**
```
æœ€å°åŒ–å…±äº«ï¼šå‡å°‘å¹¶å‘å¤æ‚æ€§çš„æ ¹æœ¬æ–¹æ³•
çŠ¶æ€éš”ç¦»ï¼šæ¯ä¸ªç»„ä»¶ç®¡ç†è‡ªå·±çš„çŠ¶æ€
æ¶ˆæ¯åè°ƒï¼šé€šè¿‡æ¶ˆæ¯è€Œéå…±äº«çŠ¶æ€åè°ƒ
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ ä¼ä¸šçº§å¼€å‘å®è·µ**
- **Webåº”ç”¨**ï¼šä½¿ç”¨çº¿ç¨‹æ± å¤„ç†è¯·æ±‚ï¼Œé¿å…åˆ›å»ºè¿‡å¤šçº¿ç¨‹
- **æ•°æ®å¤„ç†**ï¼šä½¿ç”¨åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œå°†ä»»åŠ¡åˆ†è§£åˆ°å¤šä¸ªèŠ‚ç‚¹
- **å®æ—¶ç³»ç»Ÿ**ï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å®ç°ç»„ä»¶é—´å¼‚æ­¥é€šä¿¡
- **é«˜å¹¶å‘ç³»ç»Ÿ**ï¼šä½¿ç”¨ç¼“å­˜ã€è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ç­‰ç­–ç•¥

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
- **å‡å°‘é”ç«äº‰**ï¼šç¼©å°ä¸´ç•ŒåŒºã€ä½¿ç”¨è¯»å†™é”ã€åˆ†æ®µé”
- **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨åç¨‹æˆ–å›è°ƒå¤„ç†IOå¯†é›†å‹ä»»åŠ¡
- **æ‰¹é‡æ“ä½œ**ï¼šåˆå¹¶å°è¯·æ±‚ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€
- **ç¼“å­˜ç­–ç•¥**ï¼šä½¿ç”¨æœ¬åœ°ç¼“å­˜å‡å°‘å…±äº«çŠ¶æ€è®¿é—®

**âš ï¸ å¸¸è§é™·é˜±é¿å…**
```
è¿‡æ—©ä¼˜åŒ–ï¼šå…ˆä¿è¯æ­£ç¡®æ€§ï¼Œå†è€ƒè™‘æ€§èƒ½
è¿‡åº¦åŒæ­¥ï¼šä¸è¦åœ¨ä¸éœ€è¦çš„åœ°æ–¹åŠ é”
å¿½ç•¥å¼‚å¸¸ï¼šå¹¶å‘ç¯å¢ƒä¸‹å¼‚å¸¸å¤„ç†æ›´é‡è¦
æµ‹è¯•ä¸è¶³ï¼šå¹¶å‘bugéš¾ä»¥é‡ç°ï¼Œéœ€è¦å……åˆ†æµ‹è¯•
```

### 8.4 å­¦ä¹ è¿›é˜¶å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ è·¯å¾„**
1. **ç†è®ºåŸºç¡€**ï¼šæ“ä½œç³»ç»ŸåŸç†ã€è®¡ç®—æœºä½“ç³»ç»“æ„
2. **å®è·µåº”ç”¨**ï¼šå¤šçº¿ç¨‹ç¼–ç¨‹ã€å¼‚æ­¥ç¼–ç¨‹æ¡†æ¶
3. **åˆ†å¸ƒå¼ç³»ç»Ÿ**ï¼šåˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—
4. **æ€§èƒ½è°ƒä¼˜**ï¼šJVMè°ƒä¼˜ã€æ•°æ®åº“ä¼˜åŒ–ã€ç¼“å­˜è®¾è®¡

**ğŸ”§ å·¥å…·å’Œæ¡†æ¶**
- **Java**ï¼šConcurrentåŒ…ã€Akkaæ¡†æ¶ã€CompletableFuture
- **Python**ï¼šasyncioã€multiprocessingã€threading
- **Go**ï¼šgoroutineã€channelã€syncåŒ…
- **JavaScript**ï¼šPromiseã€async/awaitã€Worker

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¹¶å‘ç¼–ç¨‹è¦è°¨æ…ï¼Œå…±äº«çŠ¶æ€æ˜¯æ ¹æº
çº¿ç¨‹è¿›ç¨‹åç¨‹æ¸…ï¼Œå„æœ‰ä¼˜åŠ¿è¦åˆ†æ˜
æ­»é”é¥¥é¥¿ç«äº‰é™©ï¼Œè®¾è®¡ä¹‹åˆè¦é˜²èŒƒ
åŸå­å¯è§æœ‰åºæ€§ï¼Œå†…å­˜æ¨¡å‹è¦ç†æ¸…
æœ€å°å…±äº«ä¸å˜å¼ï¼Œå¹‚ç­‰è®¾è®¡ä¿å®‰å…¨
ç°ä»£æ¨¡å‹åç¨‹å¥½ï¼Œå¼‚æ­¥ç¼–ç¨‹æ€ç»´æ–°
```