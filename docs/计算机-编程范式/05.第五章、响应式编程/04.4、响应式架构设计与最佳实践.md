---
title: 4ã€å“åº”å¼æ¶æ„è®¾è®¡ä¸æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [å“åº”å¼ç³»ç»Ÿæ¶æ„æ¨¡å¼](#1-å“åº”å¼ç³»ç»Ÿæ¶æ„æ¨¡å¼)
2. [äº‹ä»¶æº¯æºä¸CQRSç»“åˆ](#2-äº‹ä»¶æº¯æºä¸CQRSç»“åˆ)
3. [å¾®æœåŠ¡é—´çš„å“åº”å¼é€šä¿¡](#3-å¾®æœåŠ¡é—´çš„å“åº”å¼é€šä¿¡)
4. [å“åº”å¼æ•°æ®åº“é›†æˆ](#4-å“åº”å¼æ•°æ®åº“é›†æˆ)
5. [å†…å­˜ç®¡ç†ä¸è®¢é˜…ç”Ÿå‘½å‘¨æœŸ](#5-å†…å­˜ç®¡ç†ä¸è®¢é˜…ç”Ÿå‘½å‘¨æœŸ)
6. [æµ‹è¯•ç­–ç•¥ä¸è°ƒè¯•æŠ€å·§](#6-æµ‹è¯•ç­–ç•¥ä¸è°ƒè¯•æŠ€å·§)
7. [æ€§èƒ½ç›‘æ§ä¸å›¢é˜Ÿåä½œ](#7-æ€§èƒ½ç›‘æ§ä¸å›¢é˜Ÿåä½œ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ å“åº”å¼ç³»ç»Ÿæ¶æ„æ¨¡å¼


### 1.1 ä»€ä¹ˆæ˜¯å“åº”å¼ç³»ç»Ÿæ¶æ„


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä¸€ä¸ªæ™ºèƒ½çš„åŸå¸‚äº¤é€šç³»ç»Ÿ - å½“æŸä¸ªè·¯å£å‘ç”Ÿæ‹¥å µæ—¶ï¼Œæ•´ä¸ªäº¤é€šç½‘ç»œä¼šè‡ªåŠ¨è°ƒæ•´çº¢ç»¿ç¯æ—¶é—´ã€æ¨èæ›¿ä»£è·¯çº¿ï¼Œè®©æ•´ä¸ªåŸå¸‚çš„äº¤é€šä¿æŒæµç•…ã€‚

å“åº”å¼ç³»ç»Ÿæ¶æ„å°±æ˜¯è¿™æ ·ä¸€ç§è®¾è®¡æ€ç»´ï¼š**ç³»ç»Ÿçš„å„ä¸ªéƒ¨åˆ†èƒ½å¤Ÿå¯¹å˜åŒ–åšå‡ºå¿«é€Ÿååº”ï¼Œå¹¶ä¸”è¿™ç§ååº”èƒ½åœ¨æ•´ä¸ªç³»ç»Ÿä¸­ä¼ æ’­ï¼Œè®©æ•´ä¸ªç³»ç»Ÿä¿æŒé«˜æ•ˆè¿è¡Œ**ã€‚

```
ä¼ ç»Ÿç³»ç»Ÿ vs å“åº”å¼ç³»ç»Ÿï¼š

ä¼ ç»Ÿç³»ç»Ÿï¼ˆæ‹¥å µæ—¶ï¼‰ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ [ç­‰å¾…] â†’ æœåŠ¡å™¨å¤„ç† â†’ [ç­‰å¾…] â†’ æ•°æ®åº“ â†’ [ç­‰å¾…] â†’ è¿”å›ç»“æœ
           æ’é˜Ÿç­‰å¾…    å¤„ç†é˜»å¡      æ•°æ®åº“é”

å“åº”å¼ç³»ç»Ÿï¼ˆæµç•…æ—¶ï¼‰ï¼š
ç”¨æˆ·è¯·æ±‚ â”€â”
         â”œâ†’ å¼‚æ­¥å¤„ç† â”€â”¬â†’ ç¼“å­˜å‘½ä¸­ â”€â”€â”
         â”‚           â”œâ†’ æ•°æ®åº“æŸ¥è¯¢ â”€â”¤
         â””â†’ å®æ—¶æ¨é€ â”€â”˜             â”œâ†’ ç»„åˆç»“æœ â†’ ç”¨æˆ·
                                  â”‚
                  ç›‘æ§å‘Šè­¦ â†â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 å“åº”å¼å®£è¨€çš„å››å¤§æ”¯æŸ±


**å“åº”å¼å®£è¨€**å®šä¹‰äº†å“åº”å¼ç³»ç»Ÿçš„å››ä¸ªæ ¸å¿ƒç‰¹å¾ï¼š

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   å“åº”æ€§    â”‚ â† ç³»ç»Ÿèƒ½å¿«é€Ÿå“åº”ç”¨æˆ·
        â”‚ Responsive  â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
â”‚ å¼¹æ€§  â”‚ â”‚ éŸ§æ€§  â”‚ â”‚æ¶ˆæ¯é©±åŠ¨â”‚
â”‚Elasticâ”‚ â”‚Resilientâ”‚ â”‚Messageâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€Drivenâ”€â”˜
```

**ğŸ”¸ å“åº”æ€§ï¼ˆResponsiveï¼‰**
- **å«ä¹‰**ï¼šç³»ç»Ÿèƒ½å¤ŸåŠæ—¶å“åº”ç”¨æˆ·è¯·æ±‚
- **é€šä¿—è§£é‡Š**ï¼šå°±åƒå¥½çš„å®¢æœï¼Œé—®é¢˜æå‡ºåèƒ½å¿«é€Ÿç»™å‡ºåé¦ˆ
- **å®é™…è¡¨ç°**ï¼šé¡µé¢åŠ è½½å¿«ã€APIå“åº”å¿«ã€ç”¨æˆ·æ“ä½œæœ‰å³æ—¶åé¦ˆ

**ğŸ”¸ å¼¹æ€§ï¼ˆElasticï¼‰**
- **å«ä¹‰**ï¼šç³»ç»Ÿèƒ½æ ¹æ®è´Ÿè½½è‡ªåŠ¨æ‰©ç¼©å®¹
- **é€šä¿—è§£é‡Š**ï¼šåƒçš®ç­‹ä¸€æ ·ï¼Œæ‹‰ä¼¸æ—¶å˜é•¿ï¼Œæ”¾æ¾æ—¶ç¼©å›åŸæ ·
- **å®é™…è¡¨ç°**ï¼šç”¨æˆ·å¤šæ—¶è‡ªåŠ¨åŠ æœºå™¨ï¼Œç”¨æˆ·å°‘æ—¶è‡ªåŠ¨å‡æœºå™¨

**ğŸ”¸ éŸ§æ€§ï¼ˆResilientï¼‰**
- **å«ä¹‰**ï¼šç³»ç»Ÿåœ¨æ•…éšœæ—¶èƒ½ä¿æŒå¯ç”¨
- **é€šä¿—è§£é‡Š**ï¼šåƒä¸å€’ç¿ï¼Œè¢«æ¨å€’åèƒ½è‡ªå·±ç«™èµ·æ¥
- **å®é™…è¡¨ç°**ï¼šæŸä¸ªæœåŠ¡æŒ‚äº†ï¼Œå…¶ä»–æœåŠ¡æ­£å¸¸è¿è¡Œ

**ğŸ”¸ æ¶ˆæ¯é©±åŠ¨ï¼ˆMessage Drivenï¼‰**
- **å«ä¹‰**ï¼šç³»ç»Ÿç»„ä»¶é€šè¿‡æ¶ˆæ¯è¿›è¡Œå¼‚æ­¥é€šä¿¡
- **é€šä¿—è§£é‡Š**ï¼šåƒå¾®ä¿¡ç¾¤èŠï¼Œå¤§å®¶å‘æ¶ˆæ¯ä½†ä¸ç”¨ç­‰å›å¤å°±èƒ½ç»§ç»­
- **å®é™…è¡¨ç°**ï¼šæœåŠ¡é—´è§£è€¦ï¼Œé€šè¿‡äº‹ä»¶å’Œæ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡

### 1.3 å¸¸è§å“åº”å¼æ¶æ„æ¨¡å¼


#### ğŸ¯ äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰


**æ ¸å¿ƒæ€æƒ³**ï¼šç³»ç»Ÿé€šè¿‡äº‹ä»¶æ¥é©±åŠ¨ä¸šåŠ¡æµç¨‹

```
è®¢å•ç³»ç»Ÿäº‹ä»¶æµï¼š

ç”¨æˆ·ä¸‹å• â†’ [è®¢å•åˆ›å»ºäº‹ä»¶] â†’ 
                      â”œâ”€â†’ åº“å­˜æœåŠ¡ï¼ˆæ‰£å‡åº“å­˜ï¼‰
                      â”œâ”€â†’ æ”¯ä»˜æœåŠ¡ï¼ˆå¤„ç†æ”¯ä»˜ï¼‰
                      â”œâ”€â†’ ç‰©æµæœåŠ¡ï¼ˆå®‰æ’å‘è´§ï¼‰
                      â””â”€â†’ é€šçŸ¥æœåŠ¡ï¼ˆå‘é€ç¡®è®¤é‚®ä»¶ï¼‰

æ¯ä¸ªæœåŠ¡ç‹¬ç«‹å¤„ç†äº‹ä»¶ï¼Œä¸ç›¸äº’ç­‰å¾…
```

**å®é™…åº”ç”¨**ï¼š
```javascript
// ç®€å•çš„äº‹ä»¶å‘å¸ƒè®¢é˜…
class EventBus {
    constructor() {
        this.events = {};
    }
    
    // å‘å¸ƒäº‹ä»¶
    emit(eventName, data) {
        if (this.events[eventName]) {
            this.events[eventName].forEach(callback => callback(data));
        }
    }
    
    // è®¢é˜…äº‹ä»¶
    on(eventName, callback) {
        if (!this.events[eventName]) {
            this.events[eventName] = [];
        }
        this.events[eventName].push(callback);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const eventBus = new EventBus();

// åº“å­˜æœåŠ¡ç›‘å¬è®¢å•äº‹ä»¶
eventBus.on('order.created', (order) => {
    console.log('åº“å­˜æœåŠ¡ï¼šæ‰£å‡å•†å“åº“å­˜', order.productId);
});

// æ”¯ä»˜æœåŠ¡ç›‘å¬è®¢å•äº‹ä»¶
eventBus.on('order.created', (order) => {
    console.log('æ”¯ä»˜æœåŠ¡ï¼šå¤„ç†æ”¯ä»˜', order.amount);
});

// åˆ›å»ºè®¢å•æ—¶å‘å¸ƒäº‹ä»¶
eventBus.emit('order.created', { 
    orderId: '12345', 
    productId: 'ABC', 
    amount: 100 
});
```

#### ğŸ”„ Actoræ¨¡å‹


**æ ¸å¿ƒæ€æƒ³**ï¼šç³»ç»Ÿç”±å¾ˆå¤šç‹¬ç«‹çš„"æ¼”å‘˜"ï¼ˆActorï¼‰ç»„æˆï¼Œæ¯ä¸ªæ¼”å‘˜åªèƒ½é€šè¿‡æ¶ˆæ¯é€šä¿¡

```
Actorç³»ç»Ÿç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ¶ˆæ¯    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Actor A   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   Actor B   â”‚
â”‚   (ç”¨æˆ·)    â”‚            â”‚  (è®¢å•å¤„ç†)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                           â”‚
      â”‚ æ¶ˆæ¯                       â”‚ æ¶ˆæ¯
      â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Actor C   â”‚            â”‚   Actor D   â”‚
â”‚  (é€šçŸ¥æœåŠ¡)  â”‚            â”‚  (åº“å­˜ç®¡ç†)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯ä¸ªActorï¼š
- æœ‰è‡ªå·±çš„çŠ¶æ€ï¼ˆç§æœ‰ï¼‰
- å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯
- å¯ä»¥åˆ›å»ºæ–°çš„Actor
- å¯ä»¥å‘é€æ¶ˆæ¯ç»™å…¶ä»–Actor
```

---

## 2. ğŸ“š äº‹ä»¶æº¯æºä¸CQRSç»“åˆ


### 2.1 äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰åŸºç¡€


**ä»€ä¹ˆæ˜¯äº‹ä»¶æº¯æº**ï¼Ÿ
æƒ³è±¡ä½ åœ¨è®°è´¦ï¼Œä¼ ç»Ÿæ–¹å¼æ˜¯åªè®°å½•å½“å‰ä½™é¢ï¼Œè€Œäº‹ä»¶æº¯æºæ˜¯è®°å½•æ¯ä¸€ç¬”æ”¶æ”¯æ˜ç»†ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆåªå­˜çŠ¶æ€ï¼‰ï¼š
è´¦æˆ·ä½™é¢ï¼š1000å…ƒ

äº‹ä»¶æº¯æºæ–¹å¼ï¼ˆå­˜äº‹ä»¶å†å²ï¼‰ï¼š
- å¼€æˆ·ï¼šå­˜å…¥ 0å…ƒ
- å‘å·¥èµ„ï¼š+5000å…ƒ  
- ä¹°å’–å•¡ï¼š-30å…ƒ
- è½¬è´¦ï¼š-2000å…ƒ
- åˆ©æ¯ï¼š+30å…ƒ
å½“å‰ä½™é¢ = æ‰€æœ‰äº‹ä»¶çš„ç´¯åŠ ç»“æœ = 3000å…ƒ
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- ğŸ” **å®Œæ•´å†å²**ï¼šçŸ¥é“æ•°æ®æ˜¯æ€ä¹ˆå˜æˆç°åœ¨è¿™æ ·çš„
- ğŸ”„ **å¯é‡æ”¾**ï¼šå¯ä»¥å›åˆ°ä»»æ„æ—¶é—´ç‚¹çš„çŠ¶æ€
- ğŸ› **ä¾¿äºè°ƒè¯•**ï¼šå‡ºé—®é¢˜æ—¶èƒ½è¿½è¸ªåˆ°æ ¹æº
- ğŸ“ˆ **å®¡è®¡å‹å¥½**ï¼šå¤©ç„¶æ”¯æŒå®¡è®¡éœ€æ±‚

### 2.2 CQRSï¼ˆå‘½ä»¤æŸ¥è¯¢è´£ä»»åˆ†ç¦»ï¼‰


**ä»€ä¹ˆæ˜¯CQRS**ï¼Ÿ
å°±åƒé¤å…åˆ†å·¥ï¼šç‚¹é¤å‘˜ä¸“é—¨æ¥å•ï¼ˆCommandï¼‰ï¼ŒæœåŠ¡å‘˜ä¸“é—¨ä¸ŠèœæŸ¥çœ‹ï¼ˆQueryï¼‰ã€‚

```
ä¼ ç»ŸCRUDæ¨¡å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŒä¸€ä¸ªAPI  â”‚ â† è¯»å†™éƒ½ç”¨åŒä¸€å¥—æ¥å£
â”‚ åŒä¸€ä¸ªæ•°æ®åº“ â”‚ â† è¯»å†™éƒ½è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CQRSæ¨¡å¼ï¼š
        å†™æ“ä½œï¼ˆCommandï¼‰     è¯»æ“ä½œï¼ˆQueryï¼‰
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   å†™æ¨¡å‹     â”‚    â”‚    è¯»æ¨¡å‹    â”‚
        â”‚ (è§„èŒƒåŒ–å­˜å‚¨)  â”‚    â”‚ (æŸ¥è¯¢ä¼˜åŒ–)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
               â”‚                    â”‚
               â”‚    äº‹ä»¶åŒæ­¥          â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 äº‹ä»¶æº¯æº + CQRS ç»„åˆåº”ç”¨


**ä¸ºä»€ä¹ˆè¦ç»“åˆä½¿ç”¨**ï¼Ÿ
- äº‹ä»¶æº¯æºè§£å†³"æ€ä¹ˆå˜åŒ–"çš„é—®é¢˜
- CQRSè§£å†³"å¦‚ä½•é«˜æ•ˆæŸ¥è¯¢"çš„é—®é¢˜

```
å®Œæ•´æµç¨‹ç¤ºä¾‹ï¼š

1. ç”¨æˆ·æ“ä½œ â†’ 2. ç”Ÿæˆå‘½ä»¤ â†’ 3. å­˜å‚¨äº‹ä»¶ â†’ 4. æ›´æ–°è¯»æ¨¡å‹ â†’ 5. ç”¨æˆ·æŸ¥è¯¢

ç”¨æˆ·ä¿®æ”¹ä¸ªäººä¿¡æ¯
       â†“
[ChangeProfileCommand] â† å‘½ä»¤å¯¹è±¡
       â†“
[ProfileChangedEvent] â† äº‹ä»¶å­˜å‚¨
       â†“
æ›´æ–°ç”¨æˆ·æŸ¥è¯¢è§†å›¾ â† è¯»æ¨¡å‹åŒæ­¥
       â†“
ç”¨æˆ·çœ‹åˆ°æœ€æ–°ä¿¡æ¯ â† æŸ¥è¯¢ä¼˜åŒ–åçš„æ•°æ®
```

**å®é™…ä»£ç ç¤ºä¾‹**ï¼š
```javascript
// äº‹ä»¶å­˜å‚¨
class EventStore {
    constructor() {
        this.events = []; // å®é™…é¡¹ç›®ä¸­ä¼šç”¨æ•°æ®åº“
    }
    
    // ä¿å­˜äº‹ä»¶
    saveEvent(streamId, event) {
        this.events.push({
            streamId,
            eventType: event.type,
            data: event.data,
            timestamp: new Date()
        });
    }
    
    // è·å–æŸä¸ªå®ä½“çš„æ‰€æœ‰äº‹ä»¶
    getEvents(streamId) {
        return this.events.filter(e => e.streamId === streamId);
    }
}

// ç”¨æˆ·èšåˆï¼ˆé€šè¿‡äº‹ä»¶é‡å»ºçŠ¶æ€ï¼‰
class User {
    constructor() {
        this.id = null;
        this.name = '';
        this.email = '';
    }
    
    // é€šè¿‡äº‹ä»¶é‡å»ºç”¨æˆ·çŠ¶æ€
    static fromEvents(events) {
        const user = new User();
        events.forEach(event => {
            user.apply(event);
        });
        return user;
    }
    
    // åº”ç”¨äº‹ä»¶åˆ°å½“å‰çŠ¶æ€
    apply(event) {
        switch(event.eventType) {
            case 'UserCreated':
                this.id = event.data.id;
                this.name = event.data.name;
                this.email = event.data.email;
                break;
            case 'UserNameChanged':
                this.name = event.data.newName;
                break;
            case 'UserEmailChanged':
                this.email = event.data.newEmail;
                break;
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const eventStore = new EventStore();

// åˆ›å»ºç”¨æˆ·
eventStore.saveEvent('user-123', {
    type: 'UserCreated',
    data: { id: '123', name: 'å¼ ä¸‰', email: 'zhang@example.com' }
});

// ä¿®æ”¹ç”¨æˆ·å
eventStore.saveEvent('user-123', {
    type: 'UserNameChanged', 
    data: { newName: 'æå››' }
});

// é‡å»ºç”¨æˆ·çŠ¶æ€
const events = eventStore.getEvents('user-123');
const user = User.fromEvents(events);
console.log(user.name); // è¾“å‡ºï¼šæå››
```

---

## 3. ğŸŒ å¾®æœåŠ¡é—´çš„å“åº”å¼é€šä¿¡


### 3.1 å¾®æœåŠ¡é€šä¿¡é¢ä¸´çš„æŒ‘æˆ˜


**ä¼ ç»ŸåŒæ­¥è°ƒç”¨çš„é—®é¢˜**ï¼š
```
åŒæ­¥è°ƒç”¨é“¾ï¼ˆå®¹æ˜“å‡ºé—®é¢˜ï¼‰ï¼š

ç”¨æˆ·æœåŠ¡ â”€åŒæ­¥è°ƒç”¨â”€â†’ è®¢å•æœåŠ¡ â”€åŒæ­¥è°ƒç”¨â”€â†’ åº“å­˜æœåŠ¡ â”€åŒæ­¥è°ƒç”¨â”€â†’ æ”¯ä»˜æœåŠ¡
   â”‚                   â”‚                   â”‚                   â”‚
   â””â”€ ç­‰å¾…å“åº” â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€ ç­‰å¾…å“åº” â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€ ç­‰å¾…å“åº” â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
âŒ ä»»ä½•ä¸€ä¸ªæœåŠ¡æ…¢ï¼Œæ•´ä¸ªé“¾è·¯éƒ½æ…¢
âŒ ä»»ä½•ä¸€ä¸ªæœåŠ¡æŒ‚ï¼Œæ•´ä¸ªæµç¨‹å¤±è´¥  
âŒ æœåŠ¡é—´ç´§è€¦åˆï¼Œéš¾ä»¥ç‹¬ç«‹éƒ¨ç½²
âŒ å®¹æ˜“äº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜
```

### 3.2 å“åº”å¼é€šä¿¡æ¨¡å¼


#### ğŸ”„ å¼‚æ­¥æ¶ˆæ¯æ¨¡å¼


**æ ¸å¿ƒæ€æƒ³**ï¼šæœåŠ¡é—´é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥é€šä¿¡ï¼Œå‘é€æ–¹ä¸ç­‰å¾…å“åº”

```
å¼‚æ­¥æ¶ˆæ¯æµï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ¶ˆæ¯é˜Ÿåˆ—     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æœåŠ¡   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  è®¢å•æœåŠ¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                               â”‚
      â”‚ ç«‹å³è¿”å›                       â”‚ å¼‚æ­¥å¤„ç†
      â”‚ "è®¢å•å·²æäº¤"                    â”‚
      â”‚                               â–¼
      â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                        â”‚  åº“å­˜æœåŠ¡   â”‚
      â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                               â”‚
      â”‚ äº‹ä»¶é€šçŸ¥                       â”‚ å¤„ç†å®Œæˆ
      â”‚ "è®¢å•å¤„ç†å®Œæˆ"                  â”‚
      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®é™…å®ç°**ï¼š
```javascript
// ç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—å®ç°
class MessageQueue {
    constructor() {
        this.queues = {};
        this.subscribers = {};
    }
    
    // å‘å¸ƒæ¶ˆæ¯
    publish(topic, message) {
        if (!this.queues[topic]) {
            this.queues[topic] = [];
        }
        
        this.queues[topic].push({
            ...message,
            timestamp: new Date()
        });
        
        // é€šçŸ¥è®¢é˜…è€…
        this.notifySubscribers(topic);
    }
    
    // è®¢é˜…ä¸»é¢˜
    subscribe(topic, handler) {
        if (!this.subscribers[topic]) {
            this.subscribers[topic] = [];
        }
        this.subscribers[topic].push(handler);
    }
    
    // é€šçŸ¥è®¢é˜…è€…
    notifySubscribers(topic) {
        if (this.subscribers[topic]) {
            const messages = this.queues[topic];
            this.subscribers[topic].forEach(handler => {
                messages.forEach(message => handler(message));
            });
            // æ¸…ç©ºå·²å¤„ç†çš„æ¶ˆæ¯
            this.queues[topic] = [];
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const messageQueue = new MessageQueue();

// ç”¨æˆ·æœåŠ¡å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
class UserService {
    createOrder(orderData) {
        // æœ¬åœ°å¤„ç†
        console.log('ç”¨æˆ·æœåŠ¡ï¼šåˆ›å»ºè®¢å•è®°å½•');
        
        // å‘å¸ƒäº‹ä»¶ï¼Œä¸ç­‰å¾…å¤„ç†ç»“æœ
        messageQueue.publish('order.created', {
            orderId: orderData.id,
            userId: orderData.userId,
            products: orderData.products
        });
        
        // ç«‹å³è¿”å›ç»™ç”¨æˆ·
        return { status: 'success', message: 'è®¢å•å·²æäº¤ï¼Œæ­£åœ¨å¤„ç†ä¸­' };
    }
}

// åº“å­˜æœåŠ¡è®¢é˜…è®¢å•äº‹ä»¶
class InventoryService {
    constructor() {
        messageQueue.subscribe('order.created', this.handleOrderCreated.bind(this));
    }
    
    handleOrderCreated(orderEvent) {
        console.log('åº“å­˜æœåŠ¡ï¼šå¤„ç†è®¢å•', orderEvent.orderId);
        
        // å¼‚æ­¥å¤„ç†åº“å­˜æ‰£å‡
        setTimeout(() => {
            console.log('åº“å­˜æœåŠ¡ï¼šåº“å­˜æ‰£å‡å®Œæˆ');
            
            // å‘å¸ƒåº“å­˜å¤„ç†å®Œæˆäº‹ä»¶
            messageQueue.publish('inventory.updated', {
                orderId: orderEvent.orderId,
                status: 'completed'
            });
        }, 1000);
    }
}
```

#### ğŸ¯ äº‹ä»¶é©±åŠ¨çš„Sagaæ¨¡å¼


**ä»€ä¹ˆæ˜¯Saga**ï¼Ÿ
Sagaæ˜¯ä¸€ç§ç®¡ç†é•¿ä¸šåŠ¡æµç¨‹çš„æ¨¡å¼ï¼ŒæŠŠå¤æ‚çš„ä¸šåŠ¡æµç¨‹åˆ†è§£æˆå¤šä¸ªå°æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½å¯ä»¥ç‹¬ç«‹å®Œæˆæˆ–å›æ»šã€‚

```
è®¢å•å¤„ç†Sagaï¼š

å¼€å§‹ â†’ åˆ›å»ºè®¢å• â†’ æ‰£å‡åº“å­˜ â†’ å¤„ç†æ”¯ä»˜ â†’ å®‰æ’å‘è´§ â†’ å®Œæˆ
 â”‚        â”‚         â”‚         â”‚         â”‚         â”‚
 â”‚        â”‚         â”‚         â”‚         â”‚         â””â†’ æˆåŠŸ
 â”‚        â”‚         â”‚         â”‚         â””â†’ å¤±è´¥ï¼šå–æ¶ˆå‘è´§
 â”‚        â”‚         â”‚         â””â†’ å¤±è´¥ï¼šæ¢å¤åº“å­˜ â†’ å–æ¶ˆæ”¯ä»˜  
 â”‚        â”‚         â””â†’ å¤±è´¥ï¼šåˆ é™¤è®¢å• â†’ æ¢å¤åº“å­˜
 â”‚        â””â†’ å¤±è´¥ï¼šåˆ é™¤è®¢å•
 â””â†’ å¤±è´¥ï¼šç»“æŸ
```

**ä»£ç å®ç°**ï¼š
```javascript
// Sagaç®¡ç†å™¨
class OrderSaga {
    constructor() {
        this.steps = [];
        this.currentStep = 0;
        this.compensationActions = []; // è¡¥å¿æ“ä½œ
    }
    
    async execute(orderData) {
        try {
            // æ­¥éª¤1ï¼šåˆ›å»ºè®¢å•
            await this.createOrder(orderData);
            this.compensationActions.push(() => this.cancelOrder(orderData.id));
            
            // æ­¥éª¤2ï¼šæ‰£å‡åº“å­˜
            await this.reserveInventory(orderData);
            this.compensationActions.push(() => this.restoreInventory(orderData));
            
            // æ­¥éª¤3ï¼šå¤„ç†æ”¯ä»˜
            await this.processPayment(orderData);
            this.compensationActions.push(() => this.refundPayment(orderData));
            
            // æ­¥éª¤4ï¼šå®‰æ’å‘è´§
            await this.arrangeShipment(orderData);
            
            console.log('è®¢å•å¤„ç†å®Œæˆ');
            
        } catch (error) {
            console.log('è®¢å•å¤„ç†å¤±è´¥ï¼Œå¼€å§‹è¡¥å¿æ“ä½œ');
            await this.compensate();
        }
    }
    
    // è¡¥å¿æ“ä½œï¼ˆå›æ»šï¼‰
    async compensate() {
        // æŒ‰ç›¸åé¡ºåºæ‰§è¡Œè¡¥å¿æ“ä½œ
        for (let i = this.compensationActions.length - 1; i >= 0; i--) {
            try {
                await this.compensationActions[i]();
            } catch (error) {
                console.log('è¡¥å¿æ“ä½œå¤±è´¥:', error);
            }
        }
    }
    
    async createOrder(orderData) {
        console.log('åˆ›å»ºè®¢å•:', orderData.id);
        // æ¨¡æ‹Ÿå¯èƒ½å¤±è´¥çš„æ“ä½œ
        if (Math.random() < 0.1) throw new Error('åˆ›å»ºè®¢å•å¤±è´¥');
    }
    
    async reserveInventory(orderData) {
        console.log('æ‰£å‡åº“å­˜');
        if (Math.random() < 0.2) throw new Error('åº“å­˜ä¸è¶³');
    }
    
    async processPayment(orderData) {
        console.log('å¤„ç†æ”¯ä»˜');
        if (Math.random() < 0.15) throw new Error('æ”¯ä»˜å¤±è´¥');
    }
    
    async arrangeShipment(orderData) {
        console.log('å®‰æ’å‘è´§');
        if (Math.random() < 0.05) throw new Error('å‘è´§å¤±è´¥');
    }
    
    // è¡¥å¿æ–¹æ³•
    async cancelOrder(orderId) {
        console.log('å–æ¶ˆè®¢å•:', orderId);
    }
    
    async restoreInventory(orderData) {
        console.log('æ¢å¤åº“å­˜');
    }
    
    async refundPayment(orderData) {
        console.log('é€€æ¬¾');
    }
}
```

---

## 4. ğŸ’¾ å“åº”å¼æ•°æ®åº“é›†æˆ


### 4.1 ä»€ä¹ˆæ˜¯å“åº”å¼æ•°æ®åº“


**ä¼ ç»Ÿæ•°æ®åº“äº¤äº’**ï¼š
```
åº”ç”¨ â†’ å‘é€SQL â†’ æ•°æ®åº“å¤„ç† â†’ ç­‰å¾…ç»“æœ â†’ è¿”å›æ•°æ® â†’ åº”ç”¨ç»§ç»­

é—®é¢˜ï¼š
- åº”ç”¨è¢«é˜»å¡ç­‰å¾…
- æ•°æ®åº“è¿æ¥å ç”¨æ—¶é—´é•¿
- éš¾ä»¥å¤„ç†å¤§é‡å¹¶å‘
```

**å“åº”å¼æ•°æ®åº“äº¤äº’**ï¼š
```
åº”ç”¨ â†’ å‘é€æŸ¥è¯¢ â†’ ç«‹å³è¿”å›Promise/Stream â†’ åº”ç”¨ç»§ç»­å…¶ä»–å·¥ä½œ
                                    â†“
                              æ•°æ®å‡†å¤‡å¥½æ—¶æ¨é€ç»“æœ
```

### 4.2 å“åº”å¼æ•°æ®è®¿é—®æ¨¡å¼


#### ğŸ”„ æµå¼æŸ¥è¯¢


**æ ¸å¿ƒæ€æƒ³**ï¼šæ•°æ®æŸ¥è¯¢ç»“æœä»¥æµçš„å½¢å¼è¿”å›ï¼Œå¯ä»¥è¾¹æŸ¥è¯¢è¾¹å¤„ç†

```javascript
// ä¼ ç»Ÿæ–¹å¼ï¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
async function getAllUsers() {
    const users = await db.query('SELECT * FROM users'); // å¯èƒ½æœ‰å‡ ä¸‡æ¡
    return users; // å†…å­˜ä¸­ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
}

// å“åº”å¼æ–¹å¼ï¼šæµå¼å¤„ç†
function getUsersStream() {
    return db.queryStream('SELECT * FROM users')
        .on('data', (user) => {
            console.log('å¤„ç†ç”¨æˆ·:', user.name);
            // å¯ä»¥ç«‹å³å¤„ç†æ¯æ¡æ•°æ®ï¼Œä¸ç”¨ç­‰æ‰€æœ‰æ•°æ®åŠ è½½å®Œ
        })
        .on('end', () => {
            console.log('æ‰€æœ‰ç”¨æˆ·å¤„ç†å®Œæˆ');
        });
}
```

#### ğŸ“¡ å®æ—¶æ•°æ®æ¨é€


**ä»€ä¹ˆæ˜¯å®æ—¶æ¨é€**ï¼Ÿ
å½“æ•°æ®åº“ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨æ¨é€ç»™å…³æ³¨è¿™äº›æ•°æ®çš„åº”ç”¨ç¨‹åºã€‚

```
æ•°æ®å˜åŒ–æ¨é€æµç¨‹ï¼š

æ•°æ®åº“æ•°æ®å˜æ›´ â†’ è§¦å‘å˜æ›´äº‹ä»¶ â†’ æ¨é€ç»™è®¢é˜…è€… â†’ åº”ç”¨å®æ—¶æ›´æ–°

ä¾‹å­ï¼š
ç”¨æˆ·Aä¿®æ”¹ä¸ªäººä¿¡æ¯ â†’ æ•°æ®åº“è§¦å‘æ›´æ–°äº‹ä»¶ â†’ æ¨é€ç»™èŠå¤©åº”ç”¨ â†’ å…¶ä»–ç”¨æˆ·çœ‹åˆ°Açš„æœ€æ–°å¤´åƒ
```

**å®ç°ç¤ºä¾‹**ï¼š
```javascript
// å“åº”å¼æ•°æ®è®¿é—®å±‚
class ReactiveDatabase {
    constructor() {
        this.subscribers = {};
        this.changeStream = null;
    }
    
    // è®¢é˜…æ•°æ®å˜åŒ–
    subscribe(table, callback) {
        if (!this.subscribers[table]) {
            this.subscribers[table] = [];
        }
        this.subscribers[table].push(callback);
        
        // å¯åŠ¨å˜æ›´ç›‘å¬
        this.startChangeStream(table);
    }
    
    // ç›‘å¬æ•°æ®åº“å˜æ›´
    startChangeStream(table) {
        // è¿™é‡Œæ¨¡æ‹Ÿæ•°æ®åº“å˜æ›´æµ
        // å®é™…é¡¹ç›®ä¸­å¯èƒ½ä½¿ç”¨MongoDB Change Streams, PostgreSQL LISTEN/NOTIFYç­‰
        setInterval(() => {
            const change = {
                operation: 'update',
                table: table,
                data: { id: 1, name: 'æ›´æ–°çš„æ•°æ®' }
            };
            
            this.notifySubscribers(table, change);
        }, 5000);
    }
    
    // é€šçŸ¥è®¢é˜…è€…
    notifySubscribers(table, change) {
        if (this.subscribers[table]) {
            this.subscribers[table].forEach(callback => {
                callback(change);
            });
        }
    }
    
    // å“åº”å¼æŸ¥è¯¢
    async reactiveQuery(sql, params) {
        return new Promise((resolve, reject) => {
            // æ¨¡æ‹Ÿå¼‚æ­¥æŸ¥è¯¢
            setTimeout(() => {
                resolve([
                    { id: 1, name: 'å¼ ä¸‰' },
                    { id: 2, name: 'æå››' }
                ]);
            }, 100);
        });
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const reactiveDB = new ReactiveDatabase();

// è®¢é˜…ç”¨æˆ·è¡¨å˜åŒ–
reactiveDB.subscribe('users', (change) => {
    console.log('ç”¨æˆ·æ•°æ®å˜åŒ–:', change);
    // å¯ä»¥åœ¨è¿™é‡Œæ›´æ–°UIã€å‘é€é€šçŸ¥ç­‰
});

// å“åº”å¼æŸ¥è¯¢
reactiveDB.reactiveQuery('SELECT * FROM users')
    .then(users => {
        console.log('æŸ¥è¯¢ç»“æœ:', users);
    });
```

### 4.3 è¿æ¥æ± ä¸èƒŒå‹å¤„ç†


**ä»€ä¹ˆæ˜¯èƒŒå‹**ï¼Ÿ
å°±åƒæ°´ç®¡ï¼Œå¦‚æœæ°´æµå¤ªå¤§è¶…è¿‡äº†ç®¡é“çš„æ‰¿å—èƒ½åŠ›ï¼Œå°±ä¼šäº§ç”ŸèƒŒå‹ã€‚åœ¨æ•°æ®å¤„ç†ä¸­ï¼Œå¦‚æœæ•°æ®äº§ç”Ÿé€Ÿåº¦è¶…è¿‡äº†å¤„ç†é€Ÿåº¦ï¼Œå°±éœ€è¦èƒŒå‹å¤„ç†ã€‚

```
èƒŒå‹é—®é¢˜ç¤ºä¾‹ï¼š

æ•°æ®åº“ â”€â”€â”€â”€â”€â”€â”€â†’ åº”ç”¨ç¨‹åº
(æ¯ç§’1000æ¡)    (æ¯ç§’åªèƒ½å¤„ç†100æ¡)

ç»“æœï¼šæ•°æ®å †ç§¯ â†’ å†…å­˜æº¢å‡º â†’ ç³»ç»Ÿå´©æºƒ
```

**èƒŒå‹è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// å¸¦èƒŒå‹æ§åˆ¶çš„æ•°æ®æµå¤„ç†
class BackpressureHandler {
    constructor(maxBufferSize = 1000) {
        this.buffer = [];
        this.maxBufferSize = maxBufferSize;
        this.isProcessing = false;
    }
    
    // æ·»åŠ æ•°æ®åˆ°ç¼“å†²åŒº
    add(data) {
        if (this.buffer.length >= this.maxBufferSize) {
            console.log('ç¼“å†²åŒºæ»¡ï¼Œæš‚åœæ¥æ”¶æ•°æ®');
            return false; // æ‹’ç»æ¥æ”¶æ–°æ•°æ®
        }
        
        this.buffer.push(data);
        this.processBuffer();
        return true;
    }
    
    // å¤„ç†ç¼“å†²åŒºæ•°æ®
    async processBuffer() {
        if (this.isProcessing || this.buffer.length === 0) {
            return;
        }
        
        this.isProcessing = true;
        
        while (this.buffer.length > 0) {
            const data = this.buffer.shift();
            await this.processData(data);
            
            // æ§åˆ¶å¤„ç†é€Ÿåº¦ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½
            await this.delay(10);
        }
        
        this.isProcessing = false;
    }
    
    async processData(data) {
        console.log('å¤„ç†æ•°æ®:', data);
        // æ¨¡æ‹Ÿæ•°æ®å¤„ç†æ—¶é—´
        return new Promise(resolve => setTimeout(resolve, 50));
    }
    
    delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}
```

---

## 5. ğŸ§  å†…å­˜ç®¡ç†ä¸è®¢é˜…ç”Ÿå‘½å‘¨æœŸ


### 5.1 å†…å­˜æ³„æ¼çš„å¸¸è§åŸå› 


**ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼**ï¼Ÿ
å°±åƒä½ è®¢é˜…äº†å¾ˆå¤šæ‚å¿—ä½†ä»ä¸å–æ¶ˆï¼Œæ‚å¿—ä¼šä¸€ç›´å¯„åˆ°ä½ å®¶å ç”¨ç©ºé—´ã€‚åœ¨ç¨‹åºä¸­ï¼Œå¦‚æœåˆ›å»ºäº†å¾ˆå¤šè®¢é˜…ä½†ä¸åŠæ—¶å–æ¶ˆï¼Œå°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šå†…å­˜ã€‚

```
å†…å­˜æ³„æ¼åœºæ™¯ï¼š

âœ… æ­£å¸¸æƒ…å†µï¼š
åˆ›å»ºè®¢é˜… â†’ ä½¿ç”¨ â†’ å–æ¶ˆè®¢é˜… â†’ å†…å­˜é‡Šæ”¾

âŒ å†…å­˜æ³„æ¼ï¼š
åˆ›å»ºè®¢é˜… â†’ ä½¿ç”¨ â†’ å¿˜è®°å–æ¶ˆ â†’ å†…å­˜ä¸€ç›´å ç”¨
åˆ›å»ºè®¢é˜… â†’ ä½¿ç”¨ â†’ å¿˜è®°å–æ¶ˆ â†’ å†…å­˜ä¸€ç›´å ç”¨  
åˆ›å»ºè®¢é˜… â†’ ä½¿ç”¨ â†’ å¿˜è®°å–æ¶ˆ â†’ å†…å­˜ä¸€ç›´å ç”¨
...
```

### 5.2 è®¢é˜…ç”Ÿå‘½å‘¨æœŸç®¡ç†


#### ğŸ”„ è‡ªåŠ¨å–æ¶ˆè®¢é˜…


**æ ¸å¿ƒæ€æƒ³**ï¼šè®©è®¢é˜…èƒ½å¤Ÿè‡ªåŠ¨å–æ¶ˆï¼Œé¿å…æ‰‹åŠ¨ç®¡ç†çš„é—æ¼

```javascript
// å¸¦ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„è®¢é˜…ç®¡ç†å™¨
class SubscriptionManager {
    constructor() {
        this.subscriptions = new Set();
        this.isDestroyed = false;
    }
    
    // æ·»åŠ è®¢é˜…
    add(subscription) {
        if (this.isDestroyed) {
            subscription.unsubscribe();
            return;
        }
        
        this.subscriptions.add(subscription);
        
        // åŒ…è£…åŸå§‹çš„unsubscribeæ–¹æ³•
        const originalUnsubscribe = subscription.unsubscribe.bind(subscription);
        subscription.unsubscribe = () => {
            originalUnsubscribe();
            this.subscriptions.delete(subscription);
        };
    }
    
    // å–æ¶ˆæ‰€æœ‰è®¢é˜…
    unsubscribeAll() {
        this.subscriptions.forEach(subscription => {
            subscription.unsubscribe();
        });
        this.subscriptions.clear();
    }
    
    // é”€æ¯ç®¡ç†å™¨
    destroy() {
        this.unsubscribeAll();
        this.isDestroyed = true;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
class UserComponent {
    constructor() {
        this.subscriptionManager = new SubscriptionManager();
        this.setupSubscriptions();
    }
    
    setupSubscriptions() {
        // è®¢é˜…ç”¨æˆ·æ•°æ®å˜åŒ–
        const userSubscription = userService.getUserUpdates().subscribe(user => {
            this.updateUserInfo(user);
        });
        this.subscriptionManager.add(userSubscription);
        
        // è®¢é˜…æ¶ˆæ¯é€šçŸ¥
        const messageSubscription = messageService.getNotifications().subscribe(msg => {
            this.showNotification(msg);
        });
        this.subscriptionManager.add(messageSubscription);
    }
    
    updateUserInfo(user) {
        console.log('æ›´æ–°ç”¨æˆ·ä¿¡æ¯:', user);
    }
    
    showNotification(message) {
        console.log('æ˜¾ç¤ºé€šçŸ¥:', message);
    }
    
    // ç»„ä»¶é”€æ¯æ—¶è‡ªåŠ¨å–æ¶ˆæ‰€æœ‰è®¢é˜…
    destroy() {
        this.subscriptionManager.destroy();
    }
}
```

#### â° è¶…æ—¶è‡ªåŠ¨å–æ¶ˆ


**ä¸ºä»€ä¹ˆéœ€è¦è¶…æ—¶å–æ¶ˆ**ï¼Ÿ
æœ‰äº›è®¢é˜…å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å¼‚å¸¸ä¸€ç›´ç­‰å¾…ï¼Œéœ€è¦è®¾ç½®è¶…æ—¶è‡ªåŠ¨å–æ¶ˆã€‚

```javascript
// å¸¦è¶…æ—¶çš„è®¢é˜…åŒ…è£…å™¨
class TimeoutSubscription {
    constructor(originalSubscription, timeoutMs = 30000) {
        this.originalSubscription = originalSubscription;
        this.timeoutMs = timeoutMs;
        this.isUnsubscribed = false;
        
        // è®¾ç½®è¶…æ—¶
        this.timeoutId = setTimeout(() => {
            console.log('è®¢é˜…è¶…æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆ');
            this.unsubscribe();
        }, timeoutMs);
    }
    
    unsubscribe() {
        if (this.isUnsubscribed) return;
        
        this.isUnsubscribed = true;
        clearTimeout(this.timeoutId);
        
        if (this.originalSubscription) {
            this.originalSubscription.unsubscribe();
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
function createTimedSubscription(observable, timeoutMs) {
    const subscription = observable.subscribe({
        next: data => console.log('æ¥æ”¶æ•°æ®:', data),
        error: err => console.log('è®¢é˜…é”™è¯¯:', err),
        complete: () => console.log('è®¢é˜…å®Œæˆ')
    });
    
    return new TimeoutSubscription(subscription, timeoutMs);
}
```

### 5.3 å†…å­˜ç›‘æ§ä¸ä¼˜åŒ–


#### ğŸ“Š å†…å­˜ä½¿ç”¨ç›‘æ§


```javascript
// å†…å­˜ç›‘æ§å·¥å…·
class MemoryMonitor {
    constructor() {
        this.subscriptionCount = 0;
        this.memorySnapshots = [];
        this.startMonitoring();
    }
    
    // è®°å½•è®¢é˜…åˆ›å»º
    recordSubscriptionCreated() {
        this.subscriptionCount++;
        this.takeMemorySnapshot('subscription_created');
    }
    
    // è®°å½•è®¢é˜…å–æ¶ˆ
    recordSubscriptionDestroyed() {
        this.subscriptionCount--;
        this.takeMemorySnapshot('subscription_destroyed');
    }
    
    // è·å–å†…å­˜å¿«ç…§
    takeMemorySnapshot(label) {
        if (typeof window !== 'undefined' && window.performance && window.performance.memory) {
            const memory = window.performance.memory;
            this.memorySnapshots.push({
                label,
                timestamp: Date.now(),
                usedJSHeapSize: memory.usedJSHeapSize,
                totalJSHeapSize: memory.totalJSHeapSize,
                subscriptionCount: this.subscriptionCount
            });
        }
    }
    
    // å¼€å§‹ç›‘æ§
    startMonitoring() {
        setInterval(() => {
            this.takeMemorySnapshot('periodic_check');
            this.checkMemoryLeak();
        }, 10000); // æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
    }
    
    // æ£€æŸ¥å†…å­˜æ³„æ¼
    checkMemoryLeak() {
        if (this.memorySnapshots.length < 5) return;
        
        const recent = this.memorySnapshots.slice(-5);
        const memoryGrowth = recent[4].usedJSHeapSize - recent[0].usedJSHeapSize;
        const subscriptionGrowth = recent[4].subscriptionCount - recent[0].subscriptionCount;
        
        if (memoryGrowth > 10 * 1024 * 1024 && subscriptionGrowth > 0) { // å†…å­˜å¢é•¿è¶…è¿‡10MB
            console.warn('å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼:', {
                memoryGrowth: `${(memoryGrowth / 1024 / 1024).toFixed(2)}MB`,
                subscriptionGrowth,
                currentSubscriptions: this.subscriptionCount
            });
        }
    }
    
    // è·å–ç›‘æ§æŠ¥å‘Š
    getReport() {
        return {
            currentSubscriptions: this.subscriptionCount,
            memorySnapshots: this.memorySnapshots.slice(-10), // æœ€è¿‘10ä¸ªå¿«ç…§
            totalSnapshots: this.memorySnapshots.length
        };
    }
}

// å…¨å±€å†…å­˜ç›‘æ§å®ä¾‹
const memoryMonitor = new MemoryMonitor();
```

---

## 6. ğŸ§ª æµ‹è¯•ç­–ç•¥ä¸è°ƒè¯•æŠ€å·§


### 6.1 Marble Testingï¼ˆå¼¹ç æµ‹è¯•ï¼‰


**ä»€ä¹ˆæ˜¯Marble Testing**ï¼Ÿ
Marble Testingæ˜¯ä¸€ç§ä¸“é—¨ç”¨äºæµ‹è¯•å¼‚æ­¥å’Œå“åº”å¼ä»£ç çš„æ–¹æ³•ï¼Œç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºæ—¶é—´æµä¸Šçš„äº‹ä»¶ã€‚

```
Marbleå›¾ç¤ºä¾‹ï¼š

æ—¶é—´è½´: ----a----b----c----d----e----|
ç¬¦å·å«ä¹‰:
- : æ—¶é—´å•ä½ï¼ˆé€šå¸¸æ˜¯10msï¼‰
a,b,c : å‘å‡ºçš„æ•°æ®å€¼
| : æµå®Œæˆ
# : æµå‡ºé”™
() : åŒä¸€æ—¶é—´å‘å‡ºå¤šä¸ªå€¼ï¼Œå¦‚(abc)

å®é™…ä¾‹å­ï¼š
è¾“å…¥æµ: ----1----2----3----4----|
è½¬æ¢:   map(x => x * 2)
è¾“å‡ºæµ: ----2----4----6----8----|
```

**å®é™…æµ‹è¯•ä»£ç **ï¼š
```javascript
// ä½¿ç”¨RxJSçš„TestSchedulerè¿›è¡ŒMarble Testing
import { TestScheduler } from 'rxjs/testing';
import { map, debounceTime } from 'rxjs/operators';

describe('å“åº”å¼æ“ä½œæµ‹è¯•', () => {
    let testScheduler;
    
    beforeEach(() => {
        testScheduler = new TestScheduler((actual, expected) => {
            expect(actual).toEqual(expected);
        });
    });
    
    test('mapæ“ä½œç¬¦æµ‹è¯•', () => {
        testScheduler.run(({ hot, expectObservable }) => {
            // å®šä¹‰è¾“å…¥æµï¼šåœ¨æ—¶é—´ç‚¹a,b,cå‘å‡ºå€¼1,2,3
            const input$ = hot('  --a--b--c--|', { a: 1, b: 2, c: 3 });
            
            // åº”ç”¨mapæ“ä½œï¼šæ¯ä¸ªå€¼ä¹˜ä»¥2  
            const output$ = input$.pipe(map(x => x * 2));
            
            // æœŸæœ›çš„è¾“å‡ºæµï¼šåœ¨ç›¸åŒæ—¶é—´ç‚¹å‘å‡º2,4,6
            const expected = '    --a--b--c--|';
            const expectedValues = { a: 2, b: 4, c: 6 };
            
            expectObservable(output$).toBe(expected, expectedValues);
        });
    });
    
    test('é˜²æŠ–æ“ä½œæµ‹è¯•', () => {
        testScheduler.run(({ hot, expectObservable }) => {
            // è¾“å…¥ï¼šå¿«é€Ÿè¿ç»­çš„å€¼ï¼Œæœ€åä¸€ä¸ªå€¼åæœ‰è¶³å¤Ÿé—´éš”
            const input$ = hot('  --a-b-c----d-e----|');
            
            // åº”ç”¨é˜²æŠ–ï¼šç­‰å¾…30msæ²¡æœ‰æ–°å€¼æ‰å‘å‡º
            const output$ = input$.pipe(debounceTime(30));
            
            // æœŸæœ›ï¼šåªæœ‰cå’Œeè¢«å‘å‡ºï¼ˆå› ä¸ºå®ƒä»¬åé¢æœ‰è¶³å¤Ÿçš„é—´éš”ï¼‰
            const expected = '    --------c----e----|';
            
            expectObservable(output$).toBe(expected);
        });
    });
});
```

### 6.2 æ—¶é—´æ§åˆ¶æµ‹è¯•


**ä¸ºä»€ä¹ˆéœ€è¦æ—¶é—´æ§åˆ¶**ï¼Ÿ
æµ‹è¯•å¼‚æ­¥ä»£ç æ—¶ï¼Œå¦‚æœç­‰å¾…çœŸå®æ—¶é—´ä¼šè®©æµ‹è¯•å¾ˆæ…¢ã€‚æ—¶é—´æ§åˆ¶å¯ä»¥"å¿«è¿›"æ—¶é—´ï¼Œè®©æµ‹è¯•ç¬é—´å®Œæˆã€‚

```javascript
// æ—¶é—´æ§åˆ¶æµ‹è¯•å·¥å…·
class TimeController {
    constructor() {
        this.currentTime = 0;
        this.scheduledTasks = [];
        this.isRunning = false;
    }
    
    // è°ƒåº¦ä»»åŠ¡åœ¨æŒ‡å®šæ—¶é—´æ‰§è¡Œ
    schedule(callback, delay) {
        this.scheduledTasks.push({
            callback,
            executeAt: this.currentTime + delay
        });
        
        // æŒ‰æ‰§è¡Œæ—¶é—´æ’åº
        this.scheduledTasks.sort((a, b) => a.executeAt - b.executeAt);
    }
    
    // å¿«è¿›æ—¶é—´
    advance(timeMs) {
        const targetTime = this.currentTime + timeMs;
        
        while (this.scheduledTasks.length > 0 && this.scheduledTasks[0].executeAt <= targetTime) {
            const task = this.scheduledTasks.shift();
            this.currentTime = task.executeAt;
            task.callback();
        }
        
        this.currentTime = targetTime;
    }
    
    // æ‰§è¡Œæ‰€æœ‰å‰©ä½™ä»»åŠ¡
    flush() {
        while (this.scheduledTasks.length > 0) {
            const task = this.scheduledTasks.shift();
            this.currentTime = task.executeAt;
            task.callback();
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
describe('å®šæ—¶å™¨ç›¸å…³æµ‹è¯•', () => {
    let timeController;
    
    beforeEach(() => {
        timeController = new TimeController();
    });
    
    test('å»¶è¿Ÿæ‰§è¡Œæµ‹è¯•', () => {
        let executed = false;
        
        // æ¨¡æ‹ŸsetTimeout
        timeController.schedule(() => {
            executed = true;
        }, 1000);
        
        // è¿˜æ²¡åˆ°æ—¶é—´ï¼Œä¸åº”è¯¥æ‰§è¡Œ
        expect(executed).toBe(false);
        
        // å¿«è¿›500msï¼Œè¿˜æ˜¯ä¸åº”è¯¥æ‰§è¡Œ
        timeController.advance(500);
        expect(executed).toBe(false);
        
        // å¿«è¿›åˆ°1000msï¼Œåº”è¯¥æ‰§è¡Œäº†
        timeController.advance(500);
        expect(executed).toBe(true);
    });
});
```

### 6.3 è°ƒè¯•æŠ€å·§


#### ğŸ” æµæ•°æ®è¿½è¸ª


```javascript
// å“åº”å¼æµè°ƒè¯•å·¥å…·
class StreamDebugger {
    constructor(streamName) {
        this.streamName = streamName;
        this.events = [];
    }
    
    // æ·»åŠ åˆ°æµç®¡é“ä¸­è¿›è¡Œè°ƒè¯•
    debug() {
        return (source) => {
            return new Observable(observer => {
                console.log(`[${this.streamName}] å¼€å§‹è®¢é˜…`);
                
                return source.subscribe({
                    next: (value) => {
                        const event = {
                            type: 'next',
                            value,
                            timestamp: Date.now()
                        };
                        this.events.push(event);
                        console.log(`[${this.streamName}] å‘å‡ºå€¼:`, value);
                        observer.next(value);
                    },
                    error: (error) => {
                        const event = {
                            type: 'error',
                            error,
                            timestamp: Date.now()
                        };
                        this.events.push(event);
                        console.error(`[${this.streamName}] å‘ç”Ÿé”™è¯¯:`, error);
                        observer.error(error);
                    },
                    complete: () => {
                        const event = {
                            type: 'complete',
                            timestamp: Date.now()
                        };
                        this.events.push(event);
                        console.log(`[${this.streamName}] æµå®Œæˆ`);
                        observer.complete();
                    }
                });
            });
        };
    }
    
    // è·å–è°ƒè¯•æ—¥å¿—
    getLog() {
        return this.events;
    }
    
    // æ¸…ç©ºæ—¥å¿—
    clearLog() {
        this.events = [];
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const userSearchDebugger = new StreamDebugger('ç”¨æˆ·æœç´¢');

const searchResult$ = searchInput$
    .pipe(
        userSearchDebugger.debug(), // æ·»åŠ è°ƒè¯•
        debounceTime(300),
        distinctUntilChanged(),
        switchMap(query => searchAPI(query))
    );
```

#### ğŸ“Š æ€§èƒ½åˆ†æ


```javascript
// æ€§èƒ½ç›‘æ§å·¥å…·
class PerformanceMonitor {
    constructor() {
        this.metrics = {};
    }
    
    // å¼€å§‹æµ‹é‡
    startMeasure(operationName) {
        this.metrics[operationName] = {
            startTime: performance.now(),
            endTime: null,
            duration: null
        };
    }
    
    // ç»“æŸæµ‹é‡
    endMeasure(operationName) {
        if (this.metrics[operationName]) {
            this.metrics[operationName].endTime = performance.now();
            this.metrics[operationName].duration = 
                this.metrics[operationName].endTime - this.metrics[operationName].startTime;
            
            console.log(`${operationName} è€—æ—¶: ${this.metrics[operationName].duration.toFixed(2)}ms`);
        }
    }
    
    // åŒ…è£…å¼‚æ­¥æ“ä½œè¿›è¡Œæ€§èƒ½æµ‹é‡
    measureAsync(operationName, asyncOperation) {
        this.startMeasure(operationName);
        
        return asyncOperation()
            .then(result => {
                this.endMeasure(operationName);
                return result;
            })
            .catch(error => {
                this.endMeasure(operationName);
                throw error;
            });
    }
    
    // è·å–æ€§èƒ½æŠ¥å‘Š
    getReport() {
        return Object.entries(this.metrics).map(([name, metric]) => ({
            operation: name,
            duration: metric.duration,
            startTime: metric.startTime,
            endTime: metric.endTime
        }));
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const perfMonitor = new PerformanceMonitor();

// æµ‹é‡æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
async function queryUsers() {
    return perfMonitor.measureAsync('æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨', async () => {
        const users = await database.query('SELECT * FROM users');
        return users;
    });
}
```

---

## 7. ğŸ“ˆ æ€§èƒ½ç›‘æ§ä¸å›¢é˜Ÿåä½œ


### 7.1 å“åº”å¼ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡


**å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼ˆKPIï¼‰**ï¼š

| æŒ‡æ ‡ç±»å‹ | æŒ‡æ ‡åç§° | è¯´æ˜ | ç›®æ ‡å€¼ |
|---------|---------|------|--------|
| **å“åº”æ€§** | `å¹³å‡å“åº”æ—¶é—´` | ç”¨æˆ·æ“ä½œåˆ°çœ‹åˆ°ç»“æœçš„æ—¶é—´ | `< 200ms` |
| | `99%åˆ†ä½å“åº”æ—¶é—´` | 99%çš„è¯·æ±‚åœ¨å¤šé•¿æ—¶é—´å†…å®Œæˆ | `< 1s` |
| **å¼¹æ€§** | `è‡ªåŠ¨æ‰©å®¹æ—¶é—´` | è´Ÿè½½å¢åŠ åˆ°ç³»ç»Ÿæ‰©å®¹çš„æ—¶é—´ | `< 30s` |
| | `æ•…éšœæ¢å¤æ—¶é—´` | æœåŠ¡æ•…éšœåˆ°æ¢å¤çš„æ—¶é—´ | `< 5min` |
| **éŸ§æ€§** | `ç³»ç»Ÿå¯ç”¨æ€§` | ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶é—´æ¯”ä¾‹ | `> 99.9%` |
| | `é”™è¯¯ç‡` | è¯·æ±‚å¤±è´¥çš„æ¯”ä¾‹ | `< 0.1%` |
| **ååé‡** | `æ¯ç§’å¤„ç†è¯·æ±‚æ•°` | TPS/QPS | `æ ¹æ®ä¸šåŠ¡éœ€æ±‚` |
| | `æ¶ˆæ¯å¤„ç†å»¶è¿Ÿ` | æ¶ˆæ¯ä»å‘é€åˆ°å¤„ç†å®Œæˆçš„æ—¶é—´ | `< 100ms` |

### 7.2 ç›‘æ§ç³»ç»Ÿæ­å»º


#### ğŸ“Š å®æ—¶ç›‘æ§ä»ªè¡¨æ¿


```javascript
// ç›‘æ§æ•°æ®æ”¶é›†å™¨
class MetricsCollector {
    constructor() {
        this.metrics = {
            requestCount: 0,
            errorCount: 0,
            responseTimeSamples: [],
            activeSubscriptions: 0,
            memoryUsage: []
        };
        
        this.startCollection();
    }
    
    // è®°å½•è¯·æ±‚
    recordRequest(responseTime, isError = false) {
        this.metrics.requestCount++;
        
        if (isError) {
            this.metrics.errorCount++;
        }
        
        // è®°å½•å“åº”æ—¶é—´ï¼ˆä¿ç•™æœ€è¿‘1000ä¸ªæ ·æœ¬ï¼‰
        this.metrics.responseTimeSamples.push(responseTime);
        if (this.metrics.responseTimeSamples.length > 1000) {
            this.metrics.responseTimeSamples.shift();
        }
    }
    
    // è®°å½•è®¢é˜…å˜åŒ–
    recordSubscriptionChange(delta) {
        this.metrics.activeSubscriptions += delta;
    }
    
    // å¼€å§‹æ•°æ®æ”¶é›†
    startCollection() {
        setInterval(() => {
            this.collectMemoryUsage();
            this.publishMetrics();
        }, 5000); // æ¯5ç§’æ”¶é›†ä¸€æ¬¡
    }
    
    // æ”¶é›†å†…å­˜ä½¿ç”¨æƒ…å†µ
    collectMemoryUsage() {
        if (typeof window !== 'undefined' && window.performance && window.performance.memory) {
            const memory = window.performance.memory;
            this.metrics.memoryUsage.push({
                timestamp: Date.now(),
                used: memory.usedJSHeapSize,
                total: memory.totalJSHeapSize
            });
            
            // åªä¿ç•™æœ€è¿‘100ä¸ªæ ·æœ¬
            if (this.metrics.memoryUsage.length > 100) {
                this.metrics.memoryUsage.shift();
            }
        }
    }
    
    // å‘å¸ƒç›‘æ§æ•°æ®
    publishMetrics() {
        const currentMetrics = this.getCurrentMetrics();
        
        // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚Prometheusã€Grafanaç­‰ï¼‰
        console.log('å½“å‰ç›‘æ§æŒ‡æ ‡:', currentMetrics);
        
        // ä¹Ÿå¯ä»¥å‘é€åˆ°å®æ—¶ç›‘æ§ä»ªè¡¨æ¿
        this.sendToRealTimeDashboard(currentMetrics);
    }
    
    // è®¡ç®—å½“å‰æŒ‡æ ‡
    getCurrentMetrics() {
        const responseTimes = this.metrics.responseTimeSamples;
        const errorRate = this.metrics.requestCount > 0 
            ? (this.metrics.errorCount / this.metrics.requestCount) * 100 
            : 0;
        
        return {
            totalRequests: this.metrics.requestCount,
            errorRate: errorRate.toFixed(2) + '%',
            averageResponseTime: responseTimes.length > 0 
                ? (responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length).toFixed(2) + 'ms'
                : '0ms',
            p99ResponseTime: this.calculatePercentile(responseTimes, 99).toFixed(2) + 'ms',
            activeSubscriptions: this.metrics.activeSubscriptions,
            memoryTrend: this.getMemoryTrend()
        };
    }
    
    // è®¡ç®—ç™¾åˆ†ä½æ•°
    calculatePercentile(values, percentile) {
        if (values.length === 0) return 0;
        
        const sorted = values.slice().sort((a, b) => a - b);
        const index = Math.ceil((percentile / 100) * sorted.length) - 1;
        return sorted[index] || 0;
    }
    
    // è·å–å†…å­˜è¶‹åŠ¿
    getMemoryTrend() {
        const usage = this.metrics.memoryUsage;
        if (usage.length < 2) return 'stable';
        
        const recent = usage.slice(-10); // æœ€è¿‘10ä¸ªæ ·æœ¬
        const trend = recent[recent.length - 1].used - recent[0].used;
        
        if (trend > 1024 * 1024) return 'increasing'; // å¢é•¿è¶…è¿‡1MB
        if (trend < -1024 * 1024) return 'decreasing'; // å‡å°‘è¶…è¿‡1MB
        return 'stable';
    }
    
    // å‘é€åˆ°å®æ—¶ä»ªè¡¨æ¿
    sendToRealTimeDashboard(metrics) {
        // è¿™é‡Œå¯ä»¥ä½¿ç”¨WebSocketå‘é€åˆ°å®æ—¶ç›‘æ§ç•Œé¢
        if (window.dashboardSocket && window.dashboardSocket.readyState === WebSocket.OPEN) {
            window.dashboardSocket.send(JSON.stringify({
                type: 'metrics',
                data: metrics,
                timestamp: Date.now()
            }));
        }
    }
}
```

### 7.3 å›¢é˜Ÿåä½œä¸å“åº”å¼æ€ç»´åŸ¹å…»


#### ğŸ¤ å›¢é˜Ÿåä½œæ¨¡å¼


**å“åº”å¼å¼€å‘å›¢é˜Ÿç»„ç»‡**ï¼š
```
äº§å“å›¢é˜Ÿç»“æ„ï¼š

            äº§å“è´Ÿè´£äºº
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚       â”‚
    å‰ç«¯å›¢é˜Ÿ  åç«¯å›¢é˜Ÿ  è¿ç»´å›¢é˜Ÿ
        â”‚       â”‚       â”‚
     UI/UX   å¾®æœåŠ¡   ç›‘æ§/éƒ¨ç½²
    å“åº”å¼UI  äº‹ä»¶é©±åŠ¨  å“åº”å¼åŸºç¡€è®¾æ–½

æ²Ÿé€šæ–¹å¼ï¼š
- å¼‚æ­¥åä½œï¼šé€šè¿‡å·¥å…·å¼‚æ­¥æ²Ÿé€šï¼Œå‡å°‘ä¼šè®®ä¾èµ–
- äº‹ä»¶é©±åŠ¨ï¼šé‡è¦ä¿¡æ¯é€šè¿‡äº‹ä»¶å¹¿æ’­ï¼Œç›¸å…³äººå‘˜è‡ªåŠ¨æ¥æ”¶
- å¿«é€Ÿåé¦ˆï¼šå°æ­¥è¿­ä»£ï¼Œå¿«é€Ÿè·å¾—åé¦ˆ
```

#### ğŸ“š å“åº”å¼æ€ç»´åŸ¹å…»


**æ ¸å¿ƒæ€ç»´è½¬å˜**ï¼š

```
ä¼ ç»Ÿæ€ç»´ â†’ å“åº”å¼æ€ç»´

åŒæ­¥ç­‰å¾… â†’ å¼‚æ­¥å“åº”
"æˆ‘éœ€è¦ç­‰ç»“æœ" â†’ "æˆ‘è®¢é˜…å˜åŒ–é€šçŸ¥"

ç´§å¯†è€¦åˆ â†’ æ¾æ•£è€¦åˆ  
"Aç›´æ¥è°ƒç”¨B" â†’ "Aå‘å¸ƒäº‹ä»¶ï¼ŒBè®¢é˜…å¤„ç†"

é¢„å…ˆè§„åˆ’ â†’ é€‚åº”å˜åŒ–
"æå‰è®¡åˆ’æ‰€æœ‰æƒ…å†µ" â†’ "æ„å»ºèƒ½é€‚åº”å˜åŒ–çš„ç³»ç»Ÿ"

æ§åˆ¶æµç¨‹ â†’ å“åº”æµç¨‹
"æˆ‘æ§åˆ¶æ•´ä¸ªæµç¨‹" â†’ "æˆ‘å“åº”äº‹ä»¶æµ"
```

**å®è·µå»ºè®®**ï¼š

```markdown
ğŸ”¸ **æ—¥å¸¸å¼€å‘ä¹ æƒ¯**
- ä¼˜å…ˆè€ƒè™‘å¼‚æ­¥è§£å†³æ–¹æ¡ˆ
- ä¹ æƒ¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼
- è®¾è®¡æ—¶è€ƒè™‘äº‹ä»¶æµ
- é‡è§†é”™è¯¯å¤„ç†å’Œæ¢å¤

ğŸ”¸ **ä»£ç è¯„å®¡é‡ç‚¹**
- æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼é£é™©
- éªŒè¯é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„
- ç¡®è®¤å¼‚æ­¥æ“ä½œæ˜¯å¦æ­£ç¡®ç®¡ç†
- è¯„ä¼°ç³»ç»Ÿçš„å“åº”æ€§å’Œå¼¹æ€§

ğŸ”¸ **å›¢é˜Ÿå­¦ä¹ è®¡åˆ’**
- å®šæœŸåˆ†äº«å“åº”å¼ç¼–ç¨‹æœ€ä½³å®è·µ
- ç»„ç»‡ä»£ç èµ°è¯»ï¼Œå­¦ä¹ ä¼˜ç§€å®ç°
- å»ºç«‹å“åº”å¼è®¾è®¡æ¨¡å¼åº“
- è¿›è¡Œæ•…éšœæ¼”ç»ƒï¼Œæå‡éŸ§æ€§æ€ç»´
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å“åº”å¼ç³»ç»Ÿå››è¦ç´ ï¼šå“åº”æ€§ã€å¼¹æ€§ã€éŸ§æ€§ã€æ¶ˆæ¯é©±åŠ¨
ğŸ”¸ æ¶æ„æ¨¡å¼ï¼šäº‹ä»¶é©±åŠ¨æ¶æ„ã€Actoræ¨¡å‹ã€CQRS+äº‹ä»¶æº¯æº
ğŸ”¸ é€šä¿¡æ–¹å¼ï¼šå¼‚æ­¥æ¶ˆæ¯ã€äº‹ä»¶æµã€èƒŒå‹å¤„ç†
ğŸ”¸ ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šè®¢é˜…ç®¡ç†ã€å†…å­˜ç›‘æ§ã€è‡ªåŠ¨æ¸…ç†
ğŸ”¸ æµ‹è¯•ç­–ç•¥ï¼šMarbleæµ‹è¯•ã€æ—¶é—´æ§åˆ¶ã€æ€§èƒ½ç›‘æ§
ğŸ”¸ å›¢é˜Ÿåä½œï¼šå¼‚æ­¥åä½œã€å“åº”å¼æ€ç»´ã€æŒç»­æ”¹è¿›
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å“åº”å¼çš„æœ¬è´¨**
- **ä¸æ˜¯æŠ€æœ¯ï¼Œæ˜¯æ€ç»´æ–¹å¼**ï¼šå…ˆè€ƒè™‘å¦‚ä½•å“åº”å˜åŒ–ï¼Œå†é€‰æ‹©å…·ä½“æŠ€æœ¯
- **å¼‚æ­¥ä¼˜å…ˆ**ï¼šèƒ½å¼‚æ­¥å°±ä¸åŒæ­¥ï¼Œèƒ½äº‹ä»¶é©±åŠ¨å°±ä¸ç›´æ¥è°ƒç”¨
- **å®¹é”™è®¾è®¡**ï¼šå‡è®¾ä¸€åˆ‡éƒ½ä¼šå‡ºé”™ï¼Œæå‰è®¾è®¡æ¢å¤æœºåˆ¶

**ğŸ”¹ å®æ–½ç­–ç•¥**
- **æ¸è¿›å¼æ”¹é€ **ï¼šä¸éœ€è¦ä¸€æ¬¡æ€§é‡å†™ï¼Œå¯ä»¥é€æ­¥å¼•å…¥å“åº”å¼æ¨¡å¼
- **ç›‘æ§å…ˆè¡Œ**ï¼šå…ˆå»ºç«‹ç›‘æ§ä½“ç³»ï¼Œå†è¿›è¡Œä¼˜åŒ–æ”¹è¿›
- **å›¢é˜Ÿå…±è¯†**ï¼šå“åº”å¼å¼€å‘éœ€è¦æ•´ä¸ªå›¢é˜Ÿçš„æ€ç»´è½¬å˜

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä½•æ—¶ä½¿ç”¨å“åº”å¼æ¶æ„**
- âœ… ç³»ç»Ÿæœ‰é«˜å¹¶å‘éœ€æ±‚
- âœ… éœ€è¦å®æ—¶æ•°æ®æ›´æ–°
- âœ… ç”¨æˆ·ä½“éªŒè¦æ±‚é«˜
- âœ… ç³»ç»Ÿéœ€è¦é«˜å¯ç”¨æ€§
- âœ… å¾®æœåŠ¡æ¶æ„

**ğŸš¨ å¸¸è§é™·é˜±**
- âŒ è¿‡åº¦è®¾è®¡ï¼šå°ç³»ç»Ÿä¸éœ€è¦å¤æ‚çš„å“åº”å¼æ¶æ„
- âŒ å¿½ç•¥è°ƒè¯•ï¼šå“åº”å¼ä»£ç è°ƒè¯•å›°éš¾ï¼Œéœ€è¦ä¸“é—¨çš„å·¥å…·
- âŒ å†…å­˜æ³„æ¼ï¼šå¿˜è®°å–æ¶ˆè®¢é˜…å¯¼è‡´å†…å­˜æŒç»­å¢é•¿
- âŒ é”™è¯¯å¤„ç†ï¼šå¼‚æ­¥æ“ä½œçš„é”™è¯¯å¤„ç†ç»å¸¸è¢«å¿½ç•¥

**ğŸ”§ æœ€ä½³å®è·µ**
```
è®¾è®¡åŸåˆ™ï¼š
- ä¼˜å…ˆå¼‚æ­¥ï¼Œå¿…è¦æ—¶åŒæ­¥
- äº‹ä»¶ä¼˜å…ˆï¼Œé¿å…ç›´æ¥è€¦åˆ
- ç›‘æ§ä¼˜å…ˆï¼Œå¯è§‚æµ‹æ€§ç¬¬ä¸€
- æµ‹è¯•ä¼˜å…ˆï¼Œå“åº”å¼ä»£ç éœ€è¦ç‰¹æ®Šæµ‹è¯•ç­–ç•¥

å®æ–½å»ºè®®ï¼š
- ä»å°å¤„å¼€å§‹ï¼Œé€æ­¥æ‰©å±•
- å»ºç«‹æ ‡å‡†åŒ–çš„å“åº”å¼å¼€å‘è§„èŒƒ
- æŠ•èµ„å·¥å…·å’ŒåŸºç¡€è®¾æ–½
- æŒç»­å­¦ä¹ å’Œæ”¹è¿›
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- å“åº”å¼ç³»ç»Ÿåƒæ™ºèƒ½äº¤é€šç½‘ç»œï¼Œèƒ½è‡ªåŠ¨é€‚åº”å’Œå“åº”å˜åŒ–
- å››å¤§æ”¯æŸ±ï¼šå“åº”ã€å¼¹æ€§ã€éŸ§æ€§ã€æ¶ˆæ¯é©±åŠ¨
- å…³é”®æ˜¯æ€ç»´è½¬å˜ï¼šä»æ§åˆ¶æµç¨‹åˆ°å“åº”æµç¨‹
- å®è·µè¦ç‚¹ï¼šå¼‚æ­¥ä¼˜å…ˆã€äº‹ä»¶é©±åŠ¨ã€ç›‘æ§å®Œå–„ã€å›¢é˜Ÿåä½œ