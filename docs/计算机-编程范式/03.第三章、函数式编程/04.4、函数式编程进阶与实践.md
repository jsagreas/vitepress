---
title: 4ã€å‡½æ•°å¼ç¼–ç¨‹è¿›é˜¶ä¸å®è·µ
---
## ğŸ“š ç›®å½•

1. [æƒ°æ€§æ±‚å€¼ä¸æ— é™åºåˆ—](#1-æƒ°æ€§æ±‚å€¼ä¸æ— é™åºåˆ—)
2. [Monadæ¦‚å¿µæ·±å…¥ç†è§£](#2-monadæ¦‚å¿µæ·±å…¥ç†è§£)
3. [æ¨¡å¼åŒ¹é…ä¸ä»£æ•°æ•°æ®ç±»å‹](#3-æ¨¡å¼åŒ¹é…ä¸ä»£æ•°æ•°æ®ç±»å‹)
4. [æµå¤„ç†æŠ€æœ¯](#4-æµå¤„ç†æŠ€æœ¯)
5. [æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯](#5-æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯)
6. [ä¸å¯å˜æ•°æ®ç»“æ„åŸç†](#6-ä¸å¯å˜æ•°æ®ç»“æ„åŸç†)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ• æƒ°æ€§æ±‚å€¼ä¸æ— é™åºåˆ—


### 1.1 ä»€ä¹ˆæ˜¯æƒ°æ€§æ±‚å€¼


**é€šä¿—ç†è§£**ï¼šæƒ°æ€§æ±‚å€¼å°±åƒ"æŒ‰éœ€åšé¥­"ï¼Œåªæœ‰çœŸæ­£éœ€è¦åƒçš„æ—¶å€™æ‰å¼€å§‹åšï¼Œè€Œä¸æ˜¯æå‰æŠŠæ‰€æœ‰èœéƒ½åšå¥½ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
ä¼ ç»Ÿåšæ³•ï¼ˆä¸¥æ ¼æ±‚å€¼ï¼‰ï¼š
ä¸€æ¬¡æ€§åšå¥½ä¸€æ¡Œå­èœï¼Œä¸ç®¡å®¢äººè¦åƒä»€ä¹ˆ

æƒ°æ€§åšæ³•ï¼ˆæƒ°æ€§æ±‚å€¼ï¼‰ï¼š
ç­‰å®¢äººç‚¹èœäº†å†å¼€å§‹åšï¼Œå®¢äººä¸ç‚¹å°±ä¸åš
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **å®šä¹‰æ—¶ä¸è®¡ç®—**ï¼šè¡¨è¾¾å¼åœ¨å®šä¹‰æ—¶ä¸ç«‹å³æ‰§è¡Œ
- **ä½¿ç”¨æ—¶æ‰è®¡ç®—**ï¼šåªæœ‰çœŸæ­£éœ€è¦ç»“æœæ—¶æ‰è¿›è¡Œè®¡ç®—
- **é¿å…æµªè´¹**ï¼šä¸è®¡ç®—ç”¨ä¸åˆ°çš„å€¼

### 1.2 æƒ°æ€§æ±‚å€¼çš„å®é™…åº”ç”¨


**JavaScriptä¸­çš„æƒ°æ€§ç¤ºä¾‹**ï¼š
```javascript
// ä¸¥æ ¼æ±‚å€¼ - ç«‹å³è®¡ç®—æ‰€æœ‰å€¼
function strictMap(arr, fn) {
    const result = [];
    for (let item of arr) {
        result.push(fn(item));  // ç«‹å³è®¡ç®—æ‰€æœ‰ç»“æœ
    }
    return result;
}

// æƒ°æ€§æ±‚å€¼ - éœ€è¦æ—¶æ‰è®¡ç®—
function* lazyMap(arr, fn) {
    for (let item of arr) {
        yield fn(item);  // åªæœ‰è°ƒç”¨next()æ—¶æ‰è®¡ç®—
    }
}

// ä½¿ç”¨å¯¹æ¯”
const numbers = [1, 2, 3, 4, 5];

// ä¸¥æ ¼æ±‚å€¼ï¼šç«‹å³è®¡ç®—æ‰€æœ‰å¹³æ–¹
const strictSquares = strictMap(numbers, x => x * x);

// æƒ°æ€§æ±‚å€¼ï¼šåˆ›å»ºç”Ÿæˆå™¨ï¼Œæš‚ä¸è®¡ç®—
const lazySquares = lazyMap(numbers, x => x * x);

// åªæœ‰çœŸæ­£éœ€è¦æ—¶æ‰è®¡ç®—
console.log(lazySquares.next().value); // ç°åœ¨æ‰è®¡ç®— 1*1
```

### 1.3 æ— é™åºåˆ—çš„å¨åŠ›


**ä»€ä¹ˆæ˜¯æ— é™åºåˆ—**ï¼šç†è®ºä¸Šå¯ä»¥æ— é™å»¶ç»­çš„æ•°æ®åºåˆ—ï¼Œä½†å®é™…åªè®¡ç®—éœ€è¦çš„éƒ¨åˆ†ã€‚

```javascript
// ç”Ÿæˆæ— é™çš„æ–æ³¢é‚£å¥‘æ•°åˆ—
function* fibonacci() {
    let a = 0, b = 1;
    while (true) {  // çœ‹èµ·æ¥æ˜¯æ— é™å¾ªç¯
        yield a;
        [a, b] = [b, a + b];
    }
}

// ä½¿ç”¨æ— é™åºåˆ—
const fib = fibonacci();
console.log(fib.next().value); // 0
console.log(fib.next().value); // 1
console.log(fib.next().value); // 1
console.log(fib.next().value); // 2

// å–å‰10ä¸ªæ–æ³¢é‚£å¥‘æ•°
function take(generator, n) {
    const result = [];
    for (let i = 0; i < n; i++) {
        result.push(generator.next().value);
    }
    return result;
}

const first10Fib = take(fibonacci(), 10);
// [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]
```

**æ— é™åºåˆ—çš„ä¼˜åŠ¿**ï¼š
- ğŸ¯ **å†…å­˜æ•ˆç‡**ï¼šä¸éœ€è¦å­˜å‚¨æ‰€æœ‰å…ƒç´ 
- ğŸ¯ **æ¦‚å¿µæ¸…æ™°**ï¼šæ›´ç¬¦åˆæ•°å­¦ä¸Šçš„æ— é™æ¦‚å¿µ
- ğŸ¯ **ç»„åˆæ€§å¼º**ï¼šå¯ä»¥è½»æ¾ç»„åˆå’Œå˜æ¢

---

## 2. ğŸ§­ Monadæ¦‚å¿µæ·±å…¥ç†è§£


### 2.1 Monadåˆ°åº•æ˜¯ä»€ä¹ˆ


**é€šä¿—ç±»æ¯”**ï¼šMonadå°±åƒæ˜¯ä¸€ä¸ª"å®‰å…¨çš„ç›’å­"ï¼Œå®ƒå¸®ä½ å¤„ç†å„ç§å¯èƒ½å‡ºé”™çš„æƒ…å†µã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
æ™®é€šç¼–ç¨‹ = ç›´æ¥æ‹¿ä¸œè¥¿
å¯èƒ½å‡ºé—®é¢˜ï¼šä¸œè¥¿ä¸å­˜åœ¨ã€ä¸œè¥¿åäº†ã€æƒé™ä¸å¤Ÿ...

Monadç¼–ç¨‹ = ç”¨ä¸“ç”¨å·¥å…·ç®±
å·¥å…·ç®±ä¼šæ£€æŸ¥ï¼šæœ‰æ²¡æœ‰ä¸œè¥¿ï¼Ÿèƒ½ä¸èƒ½ç”¨ï¼Ÿæ€ä¹ˆå®‰å…¨åœ°ä¼ é€’ï¼Ÿ
```

**æ ¸å¿ƒæ€æƒ³**ï¼š
- **åŒ…è£…å€¼**ï¼šæŠŠæ™®é€šå€¼æ”¾åœ¨ä¸€ä¸ª"å®¹å™¨"é‡Œ
- **å®‰å…¨æ“ä½œ**ï¼šæä¾›å®‰å…¨çš„æ“ä½œæ–¹æ³•
- **é“¾å¼å¤„ç†**ï¼šå¯ä»¥è¿ç»­è¿›è¡Œæ“ä½œè€Œä¸ç”¨æ‹…å¿ƒå‡ºé”™

### 2.2 Maybe Monad - å¤„ç†å¯èƒ½ä¸ºç©ºçš„å€¼


**è§£å†³çš„é—®é¢˜**ï¼šåœ¨ç¼–ç¨‹ä¸­ç»å¸¸é‡åˆ°å€¼å¯èƒ½ä¸å­˜åœ¨çš„æƒ…å†µï¼Œä¼ ç»Ÿåšæ³•éœ€è¦åˆ°å¤„æ£€æŸ¥nullã€‚

```javascript
// ä¼ ç»Ÿå¤„ç†æ–¹å¼ - åˆ°å¤„éƒ½æ˜¯nullæ£€æŸ¥
function getUser(id) {
    const user = database.findUser(id);
    if (user === null) return null;
    
    const profile = user.getProfile();
    if (profile === null) return null;
    
    const email = profile.getEmail();
    if (email === null) return null;
    
    return email.toLowerCase();
}

// Maybe Monadæ–¹å¼ - ä¼˜é›…å¤„ç†
class Maybe {
    constructor(value) {
        this.value = value;
    }
    
    static of(value) {
        return new Maybe(value);
    }
    
    // å®‰å…¨çš„é“¾å¼æ“ä½œ
    map(fn) {
        return this.value === null || this.value === undefined
            ? Maybe.of(null)
            : Maybe.of(fn(this.value));
    }
    
    // è·å–æœ€ç»ˆç»“æœ
    getOrElse(defaultValue) {
        return this.value === null || this.value === undefined
            ? defaultValue
            : this.value;
    }
}

// ä½¿ç”¨Maybeä¼˜é›…å¤„ç†
function getUserEmail(id) {
    return Maybe.of(database.findUser(id))
        .map(user => user.getProfile())
        .map(profile => profile.getEmail())
        .map(email => email.toLowerCase())
        .getOrElse("æœªæ‰¾åˆ°é‚®ç®±");
}
```

### 2.3 Either Monad - å¤„ç†å¯èƒ½å‡ºé”™çš„æ“ä½œ


**è§£å†³çš„é—®é¢˜**ï¼šæœ‰äº›æ“ä½œå¯èƒ½æˆåŠŸä¹Ÿå¯èƒ½å¤±è´¥ï¼Œéœ€è¦åŒæ—¶å¤„ç†ä¸¤ç§æƒ…å†µã€‚

```javascript
// Eitherå¯ä»¥æ˜¯Left(é”™è¯¯)æˆ–Right(æˆåŠŸ)
class Either {
    constructor(value, isRight = true) {
        this.value = value;
        this.isRight = isRight;
    }
    
    static right(value) {
        return new Either(value, true);
    }
    
    static left(value) {
        return new Either(value, false);
    }
    
    map(fn) {
        // åªæœ‰æˆåŠŸæ—¶æ‰ç»§ç»­æ“ä½œ
        return this.isRight 
            ? Either.right(fn(this.value))
            : this;  // ä¿æŒé”™è¯¯çŠ¶æ€
    }
    
    // å¤„ç†é”™è¯¯æƒ…å†µ
    mapLeft(fn) {
        return this.isRight 
            ? this 
            : Either.left(fn(this.value));
    }
}

// å®é™…åº”ç”¨
function parseNumber(str) {
    const num = parseInt(str);
    return isNaN(num) 
        ? Either.left(`"${str}" ä¸æ˜¯æœ‰æ•ˆæ•°å­—`)
        : Either.right(num);
}

function divide(a, b) {
    return b === 0 
        ? Either.left("é™¤æ•°ä¸èƒ½ä¸º0")
        : Either.right(a / b);
}

// é“¾å¼å®‰å…¨è®¡ç®—
function calculate(input1, input2) {
    return parseNumber(input1)
        .map(a => 
            parseNumber(input2)
                .map(b => divide(a, b))
        );
}
```

---

## 3. ğŸ§© æ¨¡å¼åŒ¹é…ä¸ä»£æ•°æ•°æ®ç±»å‹


### 3.1 ä»€ä¹ˆæ˜¯æ¨¡å¼åŒ¹é…


**é€šä¿—ç†è§£**ï¼šæ¨¡å¼åŒ¹é…å°±åƒ"æ™ºèƒ½çš„switchè¯­å¥"ï¼Œå®ƒä¸ä»…èƒ½åŒ¹é…å€¼ï¼Œè¿˜èƒ½åŒ¹é…ç»“æ„å’Œç±»å‹ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šçœ‹åˆ°åŒ…è£¹ï¼Œæ‰“å¼€çœ‹é‡Œé¢æ˜¯ä»€ä¹ˆ

æ¨¡å¼åŒ¹é…ï¼šé€šè¿‡åŒ…è£¹çš„å½¢çŠ¶ã€å¤§å°ã€æ ‡ç­¾å°±èƒ½çŸ¥é“é‡Œé¢æ˜¯ä»€ä¹ˆï¼Œ
          å¹¶ä¸”èƒ½ç›´æ¥å–å‡ºéœ€è¦çš„éƒ¨åˆ†
```

**JavaScriptä¸­çš„æ¨¡å¼åŒ¹é…æ€æƒ³**ï¼š
```javascript
// ä¼ ç»Ÿçš„æ¡ä»¶åˆ¤æ–­
function handleResponse(response) {
    if (response.status === 'success') {
        console.log('æˆåŠŸ:', response.data);
    } else if (response.status === 'error') {
        console.log('é”™è¯¯:', response.message);
    } else if (response.status === 'loading') {
        console.log('åŠ è½½ä¸­...');
    }
}

// æ¨¡å¼åŒ¹é…æ€æƒ³çš„å®ç°
function match(value, patterns) {
    for (let pattern of patterns) {
        if (pattern.when(value)) {
            return pattern.then(value);
        }
    }
    throw new Error('æ²¡æœ‰åŒ¹é…çš„æ¨¡å¼');
}

// ä½¿ç”¨æ¨¡å¼åŒ¹é…
function handleResponseWithPattern(response) {
    return match(response, [
        {
            when: r => r.status === 'success',
            then: r => `æˆåŠŸ: ${r.data}`
        },
        {
            when: r => r.status === 'error',
            then: r => `é”™è¯¯: ${r.message}`
        },
        {
            when: r => r.status === 'loading',
            then: r => 'åŠ è½½ä¸­...'
        }
    ]);
}
```

### 3.2 ä»£æ•°æ•°æ®ç±»å‹


**ä»€ä¹ˆæ˜¯ä»£æ•°æ•°æ®ç±»å‹**ï¼šä¸€ç§å®šä¹‰æ•°æ®ç»“æ„çš„æ–¹å¼ï¼Œå¯ä»¥è¡¨ç¤º"è¿™ä¸ªæˆ–é‚£ä¸ª"ï¼ˆè”åˆç±»å‹ï¼‰çš„æ•°æ®ã€‚

```
æ•°å­¦æ¦‚å¿µï¼š
è”åˆç±»å‹ = A + B + C  (å¯ä»¥æ˜¯Aï¼Œæˆ–è€…Bï¼Œæˆ–è€…C)
ä¹˜ç§¯ç±»å‹ = A Ã— B Ã— C  (åŒæ—¶åŒ…å«Aï¼ŒBï¼ŒC)
```

**JavaScriptä¸­çš„ä»£æ•°æ•°æ®ç±»å‹æ¨¡æ‹Ÿ**ï¼š
```javascript
// å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºå½¢çŠ¶çš„ä»£æ•°æ•°æ®ç±»å‹
class Shape {
    constructor(type, data) {
        this.type = type;
        this.data = data;
    }
    
    // åˆ›å»ºåœ†å½¢
    static Circle(radius) {
        return new Shape('Circle', { radius });
    }
    
    // åˆ›å»ºçŸ©å½¢
    static Rectangle(width, height) {
        return new Shape('Rectangle', { width, height });
    }
    
    // åˆ›å»ºä¸‰è§’å½¢
    static Triangle(base, height) {
        return new Shape('Triangle', { base, height });
    }
    
    // æ¨¡å¼åŒ¹é…æ–¹æ³•
    match(patterns) {
        const pattern = patterns[this.type];
        if (pattern) {
            return pattern(this.data);
        }
        throw new Error(`æœªå¤„ç†çš„å½¢çŠ¶ç±»å‹: ${this.type}`);
    }
}

// è®¡ç®—é¢ç§¯çš„å‡½æ•°
function calculateArea(shape) {
    return shape.match({
        Circle: ({ radius }) => Math.PI * radius * radius,
        Rectangle: ({ width, height }) => width * height,
        Triangle: ({ base, height }) => 0.5 * base * height
    });
}

// ä½¿ç”¨ç¤ºä¾‹
const circle = Shape.Circle(5);
const rectangle = Shape.Rectangle(4, 6);
const triangle = Shape.Triangle(3, 8);

console.log('åœ†å½¢é¢ç§¯:', calculateArea(circle));      // 78.54
console.log('çŸ©å½¢é¢ç§¯:', calculateArea(rectangle));   // 24
console.log('ä¸‰è§’å½¢é¢ç§¯:', calculateArea(triangle)); // 12
```

---

## 4. ğŸŒŠ æµå¤„ç†æŠ€æœ¯


### 4.1 ä»€ä¹ˆæ˜¯æµå¤„ç†


**é€šä¿—ç†è§£**ï¼šæµå¤„ç†å°±åƒ"å·¥å‚æµæ°´çº¿"ï¼Œæ•°æ®åƒäº§å“ä¸€æ ·åœ¨æµæ°´çº¿ä¸Šé€æ­¥åŠ å·¥ã€‚

```
ä¼ ç»Ÿæ‰¹å¤„ç†ï¼š
æ”¶é›†æ‰€æœ‰åŸæ–™ â†’ ä¸€æ¬¡æ€§åŠ å·¥ â†’ è¾“å‡ºæ‰€æœ‰äº§å“

æµå¤„ç†ï¼š
åŸæ–™1 â†’ åŠ å·¥ â†’ äº§å“1
åŸæ–™2 â†’ åŠ å·¥ â†’ äº§å“2  (åŒæ—¶è¿›è¡Œ)
åŸæ–™3 â†’ åŠ å·¥ â†’ äº§å“3
```

**æµå¤„ç†çš„ç‰¹ç‚¹**ï¼š
- **é€ä¸ªå¤„ç†**ï¼šä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®é¡¹
- **å†…å­˜å‹å¥½**ï¼šä¸éœ€è¦æŠŠæ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜
- **å®æ—¶æ€§**ï¼šå¯ä»¥è¾¹ç”Ÿäº§è¾¹æ¶ˆè´¹

### 4.2 JavaScriptä¸­çš„æµå¤„ç†


```javascript
// åˆ›å»ºä¸€ä¸ªæ•°æ®æµ
class Stream {
    constructor(data) {
        this.data = data;
    }
    
    // æ˜ å°„è½¬æ¢
    map(fn) {
        return new Stream(this.data.map(fn));
    }
    
    // è¿‡æ»¤
    filter(predicate) {
        return new Stream(this.data.filter(predicate));
    }
    
    // å½’çº¦
    reduce(fn, initial) {
        return this.data.reduce(fn, initial);
    }
    
    // å–å‰nä¸ª
    take(n) {
        return new Stream(this.data.slice(0, n));
    }
    
    // è·³è¿‡å‰nä¸ª
    skip(n) {
        return new Stream(this.data.slice(n));
    }
    
    // æ”¶é›†ç»“æœ
    collect() {
        return this.data;
    }
}

// å®é™…åº”ç”¨ï¼šå¤„ç†ç”¨æˆ·æ•°æ®
const users = [
    { name: 'å¼ ä¸‰', age: 25, salary: 8000 },
    { name: 'æå››', age: 30, salary: 12000 },
    { name: 'ç‹äº”', age: 28, salary: 9000 },
    { name: 'èµµå…­', age: 35, salary: 15000 }
];

// æµæ°´çº¿å¤„ç†ï¼šæ‰¾å‡ºé«˜è–ªå¹´è½»å‘˜å·¥çš„å§“å
const result = new Stream(users)
    .filter(user => user.age < 30)        // è¿‡æ»¤å¹´è½»å‘˜å·¥
    .filter(user => user.salary > 8000)   // è¿‡æ»¤é«˜è–ªå‘˜å·¥
    .map(user => user.name)               // æå–å§“å
    .collect();                           // æ”¶é›†ç»“æœ

console.log(result); // ['æå››', 'ç‹äº”']
```

### 4.3 æ— é™æµçš„å¤„ç†


```javascript
// ç”Ÿæˆæ— é™æ•°æ®æµ
function* infiniteNumbers(start = 0) {
    let current = start;
    while (true) {
        yield current++;
    }
}

// æµå¤„ç†å·¥å…·
class InfiniteStream {
    constructor(generator) {
        this.generator = generator;
    }
    
    map(fn) {
        const gen = this.generator;
        return new InfiniteStream(function* () {
            for (let value of gen) {
                yield fn(value);
            }
        }());
    }
    
    filter(predicate) {
        const gen = this.generator;
        return new InfiniteStream(function* () {
            for (let value of gen) {
                if (predicate(value)) {
                    yield value;
                }
            }
        }());
    }
    
    take(n) {
        const result = [];
        const iterator = this.generator;
        for (let i = 0; i < n; i++) {
            const next = iterator.next();
            if (next.done) break;
            result.push(next.value);
        }
        return result;
    }
}

// ä½¿ç”¨æ— é™æµ
const evenSquares = new InfiniteStream(infiniteNumbers(1))
    .filter(n => n % 2 === 0)    // åªè¦å¶æ•°
    .map(n => n * n)             // è®¡ç®—å¹³æ–¹
    .take(5);                    // å–å‰5ä¸ª

console.log(evenSquares); // [4, 16, 36, 64, 100]
```

---

## 5. âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯


### 5.1 å°¾è°ƒç”¨ä¼˜åŒ–


**ä»€ä¹ˆæ˜¯å°¾è°ƒç”¨**ï¼šå‡½æ•°çš„æœ€åä¸€ä¸ªæ“ä½œæ˜¯è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–**ï¼šæ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šåœ¨è°ƒç”¨æ ˆä¸­åˆ›å»ºæ–°çš„æ ˆå¸§ï¼Œå¦‚æœé€’å½’å±‚æ¬¡å¤ªæ·±ï¼Œä¼šå¯¼è‡´æ ˆæº¢å‡ºã€‚

```javascript
// éå°¾è°ƒç”¨ - ä¼šå¯¼è‡´æ ˆæº¢å‡º
function factorial(n) {
    if (n <= 1) return 1;
    return n * factorial(n - 1);  // è¿˜éœ€è¦åšä¹˜æ³•è¿ç®—
}

// å°¾è°ƒç”¨ä¼˜åŒ–ç‰ˆæœ¬
function factorialTailCall(n, acc = 1) {
    if (n <= 1) return acc;
    return factorialTailCall(n - 1, n * acc);  // æœ€åä¸€æ­¥å°±æ˜¯å‡½æ•°è°ƒç”¨
}

// å¯è§†åŒ–è°ƒç”¨è¿‡ç¨‹
/*
éå°¾è°ƒç”¨ï¼š
factorial(5)
= 5 * factorial(4)
= 5 * (4 * factorial(3))
= 5 * (4 * (3 * factorial(2)))
= 5 * (4 * (3 * (2 * factorial(1))))
= 5 * (4 * (3 * (2 * 1)))

å°¾è°ƒç”¨ï¼š
factorialTailCall(5, 1)
= factorialTailCall(4, 5)
= factorialTailCall(3, 20)
= factorialTailCall(2, 60)
= factorialTailCall(1, 120)
= 120
*/
```

### 5.2 è®°å¿†åŒ–æŠ€æœ¯


**ä»€ä¹ˆæ˜¯è®°å¿†åŒ–**ï¼šæŠŠè®¡ç®—ç»“æœç¼“å­˜èµ·æ¥ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚

```javascript
// æ™®é€šæ–æ³¢é‚£å¥‘ - æœ‰å¤§é‡é‡å¤è®¡ç®—
function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}

// è®°å¿†åŒ–ç‰ˆæœ¬
function memoizedFibonacci() {
    const cache = new Map();
    
    function fib(n) {
        if (cache.has(n)) {
            return cache.get(n);  // ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ
        }
        
        if (n <= 1) {
            cache.set(n, n);
            return n;
        }
        
        const result = fib(n - 1) + fib(n - 2);
        cache.set(n, result);  // ç¼“å­˜ç»“æœ
        return result;
    }
    
    return fib;
}

// é€šç”¨è®°å¿†åŒ–å‡½æ•°
function memoize(fn) {
    const cache = new Map();
    return function(...args) {
        const key = JSON.stringify(args);
        if (cache.has(key)) {
            return cache.get(key);
        }
        const result = fn.apply(this, args);
        cache.set(key, result);
        return result;
    };
}

// ä½¿ç”¨é€šç”¨è®°å¿†åŒ–
const fastFib = memoize(fibonacci);
console.log(fastFib(40)); // é€Ÿåº¦å¿«å¾ˆå¤š
```

### 5.3 æƒ°æ€§æ±‚å€¼çš„æ€§èƒ½ä¼˜åŠ¿


```javascript
// åœºæ™¯ï¼šå¤„ç†å¤§é‡æ•°æ®ï¼Œä½†åªéœ€è¦å‰å‡ ä¸ªç»“æœ
const largeArray = Array.from({length: 1000000}, (_, i) => i);

// ä¸¥æ ¼æ±‚å€¼ - å¤„ç†æ‰€æœ‰æ•°æ®
function strictProcessing(arr) {
    console.time('ä¸¥æ ¼æ±‚å€¼');
    const processed = arr
        .map(x => x * 2)        // å¤„ç†100ä¸‡ä¸ª
        .filter(x => x % 3 === 0) // è¿‡æ»¤100ä¸‡ä¸ª
        .slice(0, 5);           // åªè¦å‰5ä¸ª
    console.timeEnd('ä¸¥æ ¼æ±‚å€¼');
    return processed;
}

// æƒ°æ€§æ±‚å€¼ - åªå¤„ç†éœ€è¦çš„æ•°æ®
function* lazyProcessing(arr) {
    let count = 0;
    for (let x of arr) {
        if (count >= 5) break;  // æ‰¾åˆ°5ä¸ªå°±åœæ­¢
        
        const doubled = x * 2;
        if (doubled % 3 === 0) {
            yield doubled;
            count++;
        }
    }
}

// æ€§èƒ½å¯¹æ¯”
const strictResult = strictProcessing(largeArray);
console.log('ä¸¥æ ¼æ±‚å€¼ç»“æœ:', strictResult);

console.time('æƒ°æ€§æ±‚å€¼');
const lazyResult = Array.from(lazyProcessing(largeArray));
console.timeEnd('æƒ°æ€§æ±‚å€¼');
console.log('æƒ°æ€§æ±‚å€¼ç»“æœ:', lazyResult);
```

---

## 6. ğŸ—ï¸ ä¸å¯å˜æ•°æ®ç»“æ„åŸç†


### 6.1 ä»€ä¹ˆæ˜¯ä¸å¯å˜æ•°æ®ç»“æ„


**é€šä¿—ç†è§£**ï¼šä¸å¯å˜æ•°æ®ç»“æ„å°±åƒ"å†å²æ–‡æ¡£"ï¼Œä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹ï¼Œä»»ä½•"ä¿®æ”¹"éƒ½ä¼šåˆ›å»ºæ–°ç‰ˆæœ¬ã€‚

```
ç±»æ¯”ç†è§£ï¼š
å¯å˜æ•°æ® = å¯æ“¦é™¤çš„ç™½æ¿
ä¸å¯å˜æ•°æ® = å†å²æ¡£æ¡ˆ

ä¿®æ”¹ç™½æ¿ï¼šç›´æ¥æ“¦æ‰é‡å†™
ä¿®æ”¹æ¡£æ¡ˆï¼šä¿ç•™åŸä»¶ï¼Œåˆ›å»ºæ–°çš„ä¿®è®¢ç‰ˆ
```

**æ ¸å¿ƒæ€æƒ³**ï¼š
- **æ•°æ®ä¸å˜**ï¼šä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹
- **ç»“æ„å…±äº«**ï¼šæ–°ç‰ˆæœ¬å°½å¯èƒ½å¤ç”¨æ—§ç‰ˆæœ¬çš„éƒ¨åˆ†
- **å†å²è¿½æº¯**ï¼šå¯ä»¥å›åˆ°ä»»ä½•å†å²ç‰ˆæœ¬

### 6.2 ç»“æ„å…±äº«çš„å®ç°åŸç†


```javascript
// ç®€å•çš„ä¸å¯å˜åˆ—è¡¨å®ç°
class ImmutableList {
    constructor(head = null, tail = null) {
        this.head = head;
        this.tail = tail;
        this.length = tail ? tail.length + 1 : (head === null ? 0 : 1);
    }
    
    // æ·»åŠ å…ƒç´ åˆ°å¤´éƒ¨ - åˆ›å»ºæ–°åˆ—è¡¨ï¼Œå¤ç”¨æ—§çš„tail
    prepend(value) {
        return new ImmutableList(value, this);
    }
    
    // è·å–å¤´éƒ¨å…ƒç´ 
    first() {
        return this.head;
    }
    
    // è·å–é™¤å¤´éƒ¨å¤–çš„å…¶ä½™éƒ¨åˆ†
    rest() {
        return this.tail || new ImmutableList();
    }
    
    // è½¬æ¢ä¸ºæ•°ç»„æ˜¾ç¤º
    toArray() {
        const result = [];
        let current = this;
        while (current.head !== null) {
            result.push(current.head);
            current = current.tail || new ImmutableList();
        }
        return result;
    }
}

// ä½¿ç”¨ç¤ºä¾‹ - å±•ç¤ºç»“æ„å…±äº«
const list1 = new ImmutableList()
    .prepend(3)
    .prepend(2)
    .prepend(1);
console.log('list1:', list1.toArray()); // [1, 2, 3]

const list2 = list1.prepend(0);
console.log('list2:', list2.toArray()); // [0, 1, 2, 3]
console.log('list1:', list1.toArray()); // [1, 2, 3] - åŸåˆ—è¡¨ä¸å˜

// list2çš„tailæŒ‡å‘list1ï¼Œå®ç°äº†ç»“æ„å…±äº«
```

### 6.3 ä¸å¯å˜å¯¹è±¡çš„å®ç°


```javascript
// ç®€å•çš„ä¸å¯å˜å¯¹è±¡å®ç°
class ImmutableRecord {
    constructor(data = {}) {
        // ä½¿ç”¨Object.freezeç¡®ä¿ä¸å¯ä¿®æ”¹
        this._data = Object.freeze({...data});
    }
    
    // è·å–å±æ€§å€¼
    get(key) {
        return this._data[key];
    }
    
    // "ä¿®æ”¹"å±æ€§ - å®é™…åˆ›å»ºæ–°å¯¹è±¡
    set(key, value) {
        return new ImmutableRecord({
            ...this._data,
            [key]: value
        });
    }
    
    // åˆ é™¤å±æ€§
    delete(key) {
        const newData = {...this._data};
        delete newData[key];
        return new ImmutableRecord(newData);
    }
    
    // æ‰¹é‡æ›´æ–°
    merge(other) {
        return new ImmutableRecord({
            ...this._data,
            ...other
        });
    }
    
    // è½¬æ¢ä¸ºæ™®é€šå¯¹è±¡
    toObject() {
        return {...this._data};
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const user1 = new ImmutableRecord({
    name: 'å¼ ä¸‰',
    age: 25,
    email: 'zhangsan@example.com'
});

const user2 = user1.set('age', 26);
console.log('user1å¹´é¾„:', user1.get('age')); // 25
console.log('user2å¹´é¾„:', user2.get('age')); // 26

const user3 = user2.merge({ 
    city: 'åŒ—äº¬', 
    phone: '13800138000' 
});
console.log('user3:', user3.toObject());
```

### 6.4 æ€§èƒ½ä¼˜åŒ–ï¼šå†™æ—¶å¤åˆ¶


```javascript
// å†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Writeï¼‰ä¼˜åŒ–
class OptimizedImmutableArray {
    constructor(data = [], isShared = false) {
        this._data = data;
        this._isShared = isShared;
    }
    
    // ç¡®ä¿æ•°æ®å¯ä»¥å®‰å…¨ä¿®æ”¹
    _ensureOwnership() {
        if (this._isShared) {
            this._data = [...this._data];
            this._isShared = false;
        }
    }
    
    // è·å–å…ƒç´ 
    get(index) {
        return this._data[index];
    }
    
    // è®¾ç½®å…ƒç´ 
    set(index, value) {
        this._ensureOwnership();
        const newData = [...this._data];
        newData[index] = value;
        return new OptimizedImmutableArray(newData);
    }
    
    // æ·»åŠ å…ƒç´ 
    push(value) {
        return new OptimizedImmutableArray([...this._data, value]);
    }
    
    // å…±äº«æ•°æ®ï¼ˆé¿å…ä¸å¿…è¦çš„å¤åˆ¶ï¼‰
    _share() {
        this._isShared = true;
        return new OptimizedImmutableArray(this._data, true);
    }
    
    // è½¬æ¢ä¸ºæ™®é€šæ•°ç»„
    toArray() {
        return [...this._data];
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æƒ°æ€§æ±‚å€¼ï¼šéœ€è¦æ—¶æ‰è®¡ç®—ï¼Œæé«˜æ€§èƒ½å’Œå†…å­˜æ•ˆç‡
ğŸ”¸ æ— é™åºåˆ—ï¼šç†è®ºæ— é™ä½†å®é™…æŒ‰éœ€ç”Ÿæˆçš„æ•°æ®åºåˆ—
ğŸ”¸ Monadï¼šå®‰å…¨å¤„ç†å¯èƒ½å‡ºé”™æˆ–ä¸ºç©ºçš„æ“ä½œçš„ç¼–ç¨‹æ¨¡å¼
ğŸ”¸ æ¨¡å¼åŒ¹é…ï¼šæ ¹æ®æ•°æ®ç»“æ„å’Œç±»å‹è¿›è¡Œæ™ºèƒ½åˆ†æ”¯å¤„ç†
ğŸ”¸ æµå¤„ç†ï¼šåƒæµæ°´çº¿ä¸€æ ·é€ä¸ªå¤„ç†æ•°æ®çš„æŠ€æœ¯
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šå°¾è°ƒç”¨ä¼˜åŒ–ã€è®°å¿†åŒ–ã€å†™æ—¶å¤åˆ¶ç­‰æŠ€æœ¯
ğŸ”¸ ä¸å¯å˜æ•°æ®ï¼šä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹ï¼Œé€šè¿‡ç»“æ„å…±äº«æé«˜æ•ˆç‡
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æƒ°æ€§æ±‚å€¼çš„å¨åŠ›**
```
æ ¸å¿ƒä¼˜åŠ¿ï¼š
- æŒ‰éœ€è®¡ç®—ï¼Œé¿å…æµªè´¹
- æ”¯æŒæ— é™æ•°æ®ç»“æ„
- æé«˜ç¨‹åºæ€§èƒ½å’Œå“åº”æ€§
- æ›´è‡ªç„¶åœ°è¡¨è¾¾ç®—æ³•é€»è¾‘
```

**ğŸ”¹ Monadçš„å®ç”¨ä»·å€¼**
```
è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š
- ç©ºå€¼æ£€æŸ¥çš„ç¹çä»£ç 
- é”™è¯¯å¤„ç†çš„å¤æ‚æ€§
- å¼‚æ­¥æ“ä½œçš„ç»„åˆå›°éš¾
- å‰¯ä½œç”¨çš„ç®¡ç†é—®é¢˜
```

**ğŸ”¹ ä¸å¯å˜æ•°æ®çš„æ„ä¹‰**
```
å¸¦æ¥çš„å¥½å¤„ï¼š
- å¹¶å‘å®‰å…¨ï¼Œæ— éœ€é”
- çŠ¶æ€è¿½è¸ªï¼Œä¾¿äºè°ƒè¯•
- ç¼“å­˜å‹å¥½ï¼Œå¯ä»¥å®‰å…¨å…±äº«
- å‡½æ•°å¼ç¼–ç¨‹çš„åŸºç¡€
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é€‚ç”¨åœºæ™¯åˆ¤æ–­**ï¼š
```
æƒ°æ€§æ±‚å€¼é€‚ç”¨äºï¼š
âœ… å¤§æ•°æ®é›†å¤„ç†
âœ… æ— é™æ•°æ®ç»“æ„
âœ… è®¡ç®—å¯†é›†å‹æ“ä½œ
âœ… å†…å­˜å—é™ç¯å¢ƒ

Monadé€‚ç”¨äºï¼š
âœ… é”™è¯¯å¤„ç†å¯†é›†çš„ä»£ç 
âœ… å¼‚æ­¥æ“ä½œé“¾
âœ… ç©ºå€¼æ£€æŸ¥é¢‘ç¹çš„åœºæ™¯
âœ… å‡½æ•°å¼é£æ ¼çš„é¡¹ç›®

ä¸å¯å˜æ•°æ®é€‚ç”¨äºï¼š
âœ… å¤šçº¿ç¨‹/å¹¶å‘ç¨‹åº
âœ… çŠ¶æ€ç®¡ç†å¤æ‚çš„åº”ç”¨
âœ… éœ€è¦æ’¤é”€/é‡åšåŠŸèƒ½
âœ… å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼
```

### 7.4 å­¦ä¹ è·¯å¾„å»ºè®®


**å¾ªåºæ¸è¿›çš„å­¦ä¹ æ­¥éª¤**ï¼š
```
ç¬¬1æ­¥ï¼šç†è§£åŸºæœ¬æ¦‚å¿µ
- ä»ç®€å•ä¾‹å­å¼€å§‹
- ç†è§£æ¯ä¸ªæ¦‚å¿µè§£å†³çš„é—®é¢˜
- åŠ¨æ‰‹å®è·µåŸºç¡€ç¤ºä¾‹

ç¬¬2æ­¥ï¼šæŒæ¡æ ¸å¿ƒæŠ€æœ¯
- æ·±å…¥å­¦ä¹ å®ç°åŸç†
- ç†è§£æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- å­¦ä¼šé€‰æ‹©åˆé€‚çš„æŠ€æœ¯

ç¬¬3æ­¥ï¼šå®é™…é¡¹ç›®åº”ç”¨
- åœ¨çœŸå®é¡¹ç›®ä¸­ä½¿ç”¨
- ç§¯ç´¯æœ€ä½³å®è·µç»éªŒ
- å½¢æˆè‡ªå·±çš„ç¼–ç¨‹é£æ ¼
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- å‡½æ•°å¼ç¼–ç¨‹è¿½æ±‚**ç®€æ´ã€å®‰å…¨ã€é«˜æ•ˆ**
- æƒ°æ€§æ±‚å€¼è®©ç¨‹åº**æ›´æ™ºèƒ½**ï¼ŒMonadè®©ä»£ç **æ›´å®‰å…¨**
- ä¸å¯å˜æ•°æ®è®©çŠ¶æ€**æ›´å¯æ§**ï¼Œæµå¤„ç†è®©é€»è¾‘**æ›´æ¸…æ™°**
- æŒæ¡è¿™äº›æŠ€æœ¯èƒ½å†™å‡º**æ›´ä¼˜é›…ã€æ›´å¯é **çš„ä»£ç 