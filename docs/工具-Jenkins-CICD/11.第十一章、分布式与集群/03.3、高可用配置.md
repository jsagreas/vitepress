---
title: 3ã€é«˜å¯ç”¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [Jenkinsé«˜å¯ç”¨åŸºç¡€æ¦‚å¿µ](#1-jenkinsé«˜å¯ç”¨åŸºç¡€æ¦‚å¿µ)
2. [é›†ç¾¤æ¶æ„è®¾è®¡](#2-é›†ç¾¤æ¶æ„è®¾è®¡)
3. [æ•°æ®åŒæ­¥é…ç½®](#3-æ•°æ®åŒæ­¥é…ç½®)
4. [æ•…éšœè½¬ç§»æœºåˆ¶](#4-æ•…éšœè½¬ç§»æœºåˆ¶)
5. [è´Ÿè½½å‡è¡¡å®ç°](#5-è´Ÿè½½å‡è¡¡å®ç°)
6. [æœåŠ¡å¥åº·æ£€æŸ¥](#6-æœåŠ¡å¥åº·æ£€æŸ¥)
7. [å®¹ç¾å¤‡ä»½æ–¹æ¡ˆ](#7-å®¹ç¾å¤‡ä»½æ–¹æ¡ˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ Jenkinsé«˜å¯ç”¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Jenkinsé«˜å¯ç”¨


**é€šä¿—ç†è§£**ï¼šå°±åƒä¸€ä¸ªå·¥å‚æœ‰å¤šæ¡ç”Ÿäº§çº¿ï¼Œå¦‚æœä¸€æ¡çº¿å‡ºæ•…éšœäº†ï¼Œå…¶ä»–çº¿è¿˜èƒ½ç»§ç»­å·¥ä½œï¼Œä¿è¯ç”Ÿäº§ä¸åœæ­¢ã€‚

```
ğŸ’­ ç”Ÿæ´»ç±»æ¯”
å•ç‚¹Jenkins = åªæœ‰ä¸€å°ATMæœº
é«˜å¯ç”¨Jenkins = é“¶è¡Œæœ‰å¤šå°ATMæœºï¼Œåä¸€å°ä¸å½±å“å–é’±

ç›®æ ‡ï¼šç¡®ä¿CI/CDæµç¨‹7Ã—24å°æ—¶ä¸é—´æ–­è¿è¡Œ
```

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
- **é«˜å¯ç”¨(HA)**ï¼šç³»ç»Ÿèƒ½å¤ŸæŒç»­è¿è¡Œï¼Œå³ä½¿éƒ¨åˆ†ç»„ä»¶æ•…éšœ
- **å•ç‚¹æ•…éšœ**ï¼šä¸€ä¸ªç»„ä»¶åäº†ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¸èƒ½ç”¨äº†
- **æ•…éšœè½¬ç§»**ï¼šä¸»æœåŠ¡å™¨åäº†ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨
- **è´Ÿè½½åˆ†æ‹…**ï¼šå¤šå°æœåŠ¡å™¨ä¸€èµ·åˆ†æ‹…å·¥ä½œå‹åŠ›

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Jenkinsé«˜å¯ç”¨


**ä¸šåŠ¡åœºæ™¯è¯´æ˜**ï¼š

```
ğŸ¯ å®é™…é—®é¢˜
â€¢ å¼€å‘å›¢é˜Ÿæ¯å¤©æäº¤ä»£ç ä¸Šç™¾æ¬¡
â€¢ JenkinsæœåŠ¡å™¨æ•…éšœå¯¼è‡´æ‰€æœ‰æ„å»ºåœæ­¢
â€¢ å½±å“äº§å“å‘å¸ƒï¼Œé€ æˆç»æµæŸå¤±
â€¢ å¼€å‘äººå‘˜æ— æ³•åŠæ—¶å‘ç°é—®é¢˜

ğŸ”¸ é«˜å¯ç”¨çš„ä»·å€¼
âœ… ä¿è¯æ„å»ºæœåŠ¡ä¸ä¸­æ–­
âœ… æå‡å›¢é˜Ÿå¼€å‘æ•ˆç‡  
âœ… é™ä½ç³»ç»Ÿæ•…éšœé£é™©
âœ… æ”¯æŒæ›´å¤§è§„æ¨¡çš„å›¢é˜Ÿåä½œ
```

### 1.3 Jenkinsé«˜å¯ç”¨çš„æŒ‘æˆ˜


**æŠ€æœ¯éš¾ç‚¹**ï¼š
- **çŠ¶æ€åŒæ­¥**ï¼šå¤šå°Jenkinså¦‚ä½•ä¿æŒæ•°æ®ä¸€è‡´
- **ä»»åŠ¡åˆ†é…**ï¼šæ„å»ºä»»åŠ¡å¦‚ä½•åˆç†åˆ†é…
- **é…ç½®ç®¡ç†**ï¼šæ’ä»¶å’Œé…ç½®å¦‚ä½•ç»Ÿä¸€ç®¡ç†
- **å­˜å‚¨å…±äº«**ï¼šå·¥ä½œç©ºé—´å’Œæ„å»ºäº§ç‰©å¦‚ä½•å…±äº«

---

## 2. ğŸ¢ é›†ç¾¤æ¶æ„è®¾è®¡


### 2.1 ä¸»ä»æ¶æ„æ¨¡å¼


**æ¶æ„è¯´æ˜**ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„Jenkinsé›†ç¾¤æ–¹æ¡ˆï¼Œå°±åƒå…¬å¸çš„æ€»éƒ¨å’Œåˆ†å…¬å¸å…³ç³»ã€‚

```
é›†ç¾¤æ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             è´Ÿè½½å‡è¡¡å™¨                   â”‚
â”‚        (Nginx/HAProxy)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Jenkinsâ”‚   â”‚Jenkinsâ”‚   â”‚ å…±äº«å­˜å‚¨ â”‚
â”‚Master1â”‚   â”‚Master2â”‚   â”‚ (NFS/   â”‚
â”‚ (ä¸»)  â”‚   â”‚ (å¤‡)  â”‚   â”‚ GlusterFS)â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
â”‚   Jenkins Agent   â”‚
â”‚   (æ„å»ºèŠ‚ç‚¹æ± )     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶èŒè´£è¯´æ˜**ï¼š

| ç»„ä»¶ | **ä½œç”¨è¯´æ˜** | **é€šä¿—æ¯”å–»** |
|------|-------------|-------------|
| **è´Ÿè½½å‡è¡¡å™¨** | `åˆ†å‘ç”¨æˆ·è¯·æ±‚åˆ°å¯ç”¨çš„JenkinsæœåŠ¡å™¨` | `é“¶è¡Œå¤§å…çš„å«å·æœº` |
| **Jenkins Master** | `è°ƒåº¦æ„å»ºä»»åŠ¡ï¼Œç®¡ç†é…ç½®ï¼Œæä¾›Webç•Œé¢` | `é¡¹ç›®ç»ç†ï¼Œåˆ†é…ä»»åŠ¡ç»™å›¢é˜Ÿ` |
| **Jenkins Agent** | `æ‰§è¡Œå…·ä½“çš„æ„å»ºå·¥ä½œ` | `å·¥äººï¼ŒæŒ‰ç…§æŒ‡ä»¤å¹²æ´»` |
| **å…±äº«å­˜å‚¨** | `å­˜å‚¨æ„å»ºäº§ç‰©ã€å·¥ä½œç©ºé—´ã€é…ç½®æ–‡ä»¶` | `å…¬å¸çš„æ–‡ä»¶æŸœï¼Œå¤§å®¶éƒ½èƒ½ç”¨` |

### 2.2 Active-Passiveæ¨¡å¼


**å·¥ä½œåŸç†**ï¼šåŒä¸€æ—¶é—´åªæœ‰ä¸€å°Jenkinsåœ¨å·¥ä½œï¼Œå¦ä¸€å°å¾…æœºã€‚

```
è¿è¡ŒçŠ¶æ€ï¼š
æ­£å¸¸æƒ…å†µï¼š
Master1 (è¿è¡Œä¸­) â”€â”€â”
                   â”œâ”€â”€ ç”¨æˆ·è®¿é—®è¿™å°
Master2 (å¾…æœº)   â”€â”€â”˜

æ•…éšœæƒ…å†µï¼š
Master1 (æ•…éšœ) â”€â”€â”€â”€â”
                   â”œâ”€â”€ è‡ªåŠ¨åˆ‡æ¢åˆ°è¿™å°
Master2 (æ¥ç®¡) â”€â”€â”€â”€â”˜
```

**ä¼˜ç¼ºç‚¹åˆ†æ**ï¼š
```
âœ… ä¼˜ç‚¹ï¼š
â€¢ é…ç½®ç®€å•ï¼Œå®¹æ˜“ç†è§£
â€¢ é¿å…æ•°æ®å†²çªé—®é¢˜
â€¢ æ•…éšœåˆ‡æ¢ç›¸å¯¹å¯é 

âŒ ç¼ºç‚¹ï¼š
â€¢ èµ„æºåˆ©ç”¨ç‡ä½ï¼ˆ50%ï¼‰
â€¢ åˆ‡æ¢æ—¶é—´è¾ƒé•¿ï¼ˆ1-5åˆ†é’Ÿï¼‰
â€¢ ä¸èƒ½è§£å†³æ€§èƒ½ç“¶é¢ˆ
```

### 2.3 Active-Activeæ¨¡å¼


**å·¥ä½œåŸç†**ï¼šå¤šå°JenkinsåŒæ—¶å·¥ä½œï¼Œå…±åŒå¤„ç†è¯·æ±‚ã€‚

```
è´Ÿè½½åˆ†æ‹…ç¤ºæ„ï¼š
ç”¨æˆ·è¯·æ±‚ â”€â”€â†’ è´Ÿè½½å‡è¡¡å™¨
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
        â–¼     â–¼     â–¼
    Jenkins Jenkins Jenkins
      #1      #2      #3
        â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
              â–¼
          å…±äº«æ•°æ®åº“
```

**å®ç°è¦æ±‚**ï¼š
- **æ— çŠ¶æ€è®¾è®¡**ï¼šJenkinsä¸èƒ½ä¾èµ–æœ¬åœ°å­˜å‚¨
- **æ•°æ®åº“å¤–ç½®**ï¼šæ‰€æœ‰é…ç½®å­˜å‚¨åœ¨å¤–éƒ¨æ•°æ®åº“
- **ä¼šè¯åŒæ­¥**ï¼šç”¨æˆ·ç™»å½•çŠ¶æ€éœ€è¦å…±äº«

---

## 3. ğŸ”„ æ•°æ®åŒæ­¥é…ç½®


### 3.1 å…³é”®æ•°æ®ç±»å‹


**éœ€è¦åŒæ­¥çš„æ•°æ®**ï¼š

```
ğŸ“Š Jenkinsæ•°æ®åˆ†ç±»

ğŸ”¸ é…ç½®æ•°æ®ï¼š
â€¢ jobs/ï¼ˆä»»åŠ¡é…ç½®ï¼‰
â€¢ users/ï¼ˆç”¨æˆ·ä¿¡æ¯ï¼‰  
â€¢ plugins/ï¼ˆæ’ä»¶é…ç½®ï¼‰
â€¢ secrets/ï¼ˆå¯†é’¥ä¿¡æ¯ï¼‰

ğŸ”¸ è¿è¡Œæ•°æ®ï¼š
â€¢ builds/ï¼ˆæ„å»ºå†å²ï¼‰
â€¢ workspace/ï¼ˆå·¥ä½œç©ºé—´ï¼‰
â€¢ logs/ï¼ˆæ„å»ºæ—¥å¿—ï¼‰
â€¢ artifacts/ï¼ˆæ„å»ºäº§ç‰©ï¼‰

ğŸ”¸ ä¸´æ—¶æ•°æ®ï¼š
â€¢ queue/ï¼ˆæ„å»ºé˜Ÿåˆ—ï¼‰
â€¢ cache/ï¼ˆç¼“å­˜æ–‡ä»¶ï¼‰
â€¢ tmp/ï¼ˆä¸´æ—¶æ–‡ä»¶ï¼‰
```

### 3.2 æ–‡ä»¶ç³»ç»ŸåŒæ­¥æ–¹æ¡ˆ


**NFSå…±äº«å­˜å‚¨é…ç½®**ï¼š

```bash
# æœåŠ¡å™¨ç«¯é…ç½® (/etc/exports)
/var/jenkins_home 192.168.1.0/24(rw,sync,no_subtree_check)

# å®¢æˆ·ç«¯æŒ‚è½½
sudo mount -t nfs 192.168.1.100:/var/jenkins_home /var/jenkins_home
```

**ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹**ï¼š
```
âœ… å®æ–½ç®€å•ï¼š
â€¢ é…ç½®æ­¥éª¤å°‘ï¼ŒæŠ€æœ¯é—¨æ§›ä½
â€¢ æ•°æ®å®æ—¶åŒæ­¥ï¼Œä¸€è‡´æ€§å¥½

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
â€¢ ç½‘ç»œä¾èµ–å¼ºï¼Œç½‘ç»œæ•…éšœå½±å“å¤§
â€¢ æ€§èƒ½ç“¶é¢ˆï¼Œå¤§æ–‡ä»¶è¯»å†™æ…¢
â€¢ éœ€è¦è€ƒè™‘NFSæœåŠ¡å™¨çš„é«˜å¯ç”¨
```

### 3.3 æ•°æ®åº“å¤–ç½®æ–¹æ¡ˆ


**PostgreSQLé…ç½®ç¤ºä¾‹**ï¼š

```yaml
# docker-compose.yml
version: '3.8'
services:
  jenkins-db:
    image: postgres:13
    environment:
      POSTGRES_DB: jenkins
      POSTGRES_USER: jenkins_user
      POSTGRES_PASSWORD: secure_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    
  jenkins1:
    image: jenkins/jenkins:lts
    environment:
      JENKINS_OPTS: "--httpPort=8080"
    volumes:
      - jenkins_config:/var/jenkins_home
    depends_on:
      - jenkins-db
```

**æ•°æ®åº“æ–¹æ¡ˆä¼˜åŠ¿**ï¼š
- **æ•°æ®ä¸€è‡´æ€§**ï¼šACIDç‰¹æ€§ä¿è¯æ•°æ®å¯é 
- **æŸ¥è¯¢æ•ˆç‡**ï¼šæ”¯æŒå¤æ‚æŸ¥è¯¢å’Œç»Ÿè®¡
- **å¤‡ä»½æ¢å¤**ï¼šæ•°æ®åº“å¤‡ä»½æœºåˆ¶æˆç†Ÿ

---

## 4. âš¡ æ•…éšœè½¬ç§»æœºåˆ¶


### 4.1 è‡ªåŠ¨æ•…éšœæ£€æµ‹


**å¥åº·æ£€æŸ¥æœºåˆ¶**ï¼š

```
æ£€æµ‹ç»´åº¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡æ£€æŸ¥   â”‚   ç³»ç»Ÿæ£€æŸ¥   â”‚  ä¸šåŠ¡æ£€æŸ¥   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HTTPå“åº”    â”‚ CPUä½¿ç”¨ç‡    â”‚ æ„å»ºé˜Ÿåˆ—    â”‚
â”‚ ç«¯å£è¿é€šæ€§  â”‚ å†…å­˜ä½¿ç”¨ç‡   â”‚ æ’ä»¶çŠ¶æ€    â”‚
â”‚ è¿›ç¨‹çŠ¶æ€    â”‚ ç£ç›˜ç©ºé—´     â”‚ æ•°æ®åº“è¿æ¥  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ£€æŸ¥è„šæœ¬ç¤ºä¾‹**ï¼š

```bash
#!/bin/bash
# jenkins_health_check.sh

JENKINS_URL="http://localhost:8080"
TIMEOUT=10

# åŸºç¡€è¿é€šæ€§æ£€æŸ¥
if ! curl -s --max-time $TIMEOUT "$JENKINS_URL/login" > /dev/null; then
    echo "JenkinsæœåŠ¡ä¸å¯è¾¾"
    exit 1
fi

# APIå¥åº·æ£€æŸ¥
if ! curl -s --max-time $TIMEOUT "$JENKINS_URL/api/json" | grep -q "jobs"; then
    echo "Jenkins APIå¼‚å¸¸"
    exit 1
fi

echo "JenkinsæœåŠ¡æ­£å¸¸"
exit 0
```

### 4.2 Keepalivedå®ç°æ–¹æ¡ˆ


**é…ç½®è¯´æ˜**ï¼šKeepalivedå°±åƒä¸€ä¸ªçœ‹é—¨äººï¼Œç›‘æ§JenkinsæœåŠ¡çŠ¶æ€ï¼Œè‡ªåŠ¨è¿›è¡Œæ•…éšœåˆ‡æ¢ã€‚

```bash
# /etc/keepalived/keepalived.conf (ä¸»æœåŠ¡å™¨)
vrrp_script chk_jenkins {
    script "/usr/local/bin/jenkins_health_check.sh"
    interval 2    # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
    fall 3        # è¿ç»­3æ¬¡å¤±è´¥æ‰åˆ¤å®šæ•…éšœ
    rise 2        # è¿ç»­2æ¬¡æˆåŠŸæ‰åˆ¤å®šæ¢å¤
}

vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 110  # ä¸»æœåŠ¡å™¨ä¼˜å…ˆçº§é«˜
    advert_int 1
    
    authentication {
        auth_type PASS
        auth_pass your_password
    }
    
    virtual_ipaddress {
        192.168.1.200  # è™šæ‹ŸIPåœ°å€
    }
    
    track_script {
        chk_jenkins
    }
}
```

**åˆ‡æ¢æµç¨‹**ï¼š
```
æ•…éšœè½¬ç§»è¿‡ç¨‹ï¼š
1. ä¸»æœåŠ¡å™¨æ•…éšœ â”€â”€â†’ Keepalivedæ£€æµ‹åˆ°å¼‚å¸¸
2. åœæ­¢è™šæ‹ŸIP â”€â”€â†’ è™šæ‹ŸIPä»ä¸»æœåŠ¡å™¨ä¸Šç§»é™¤
3. å¤‡æœåŠ¡å™¨æ¥ç®¡ â”€â”€â†’ è™šæ‹ŸIPç»‘å®šåˆ°å¤‡æœåŠ¡å™¨
4. æœåŠ¡ç»§ç»­è¿è¡Œ â”€â”€â†’ ç”¨æˆ·è®¿é—®è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡æœåŠ¡å™¨

åˆ‡æ¢æ—¶é—´ï¼šé€šå¸¸åœ¨10-30ç§’å†…å®Œæˆ
```

### 4.3 æ•…éšœæ¢å¤ç­–ç•¥


**è‡ªåŠ¨å›åˆ‡vsæ‰‹åŠ¨å›åˆ‡**ï¼š

| ç­–ç•¥ç±»å‹ | **å·¥ä½œæ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|---------|-------------|-------------|-----------|
| **è‡ªåŠ¨å›åˆ‡** | `ä¸»æœåŠ¡å™¨æ¢å¤åè‡ªåŠ¨æŠ¢å è™šæ‹ŸIP` | `æ•…éšœç®€å•ï¼Œæ¢å¤å¿«é€Ÿ` | `âœ…ç®€å• âŒå¯èƒ½é¢‘ç¹åˆ‡æ¢` |
| **æ‰‹åŠ¨å›åˆ‡** | `äººå·¥ç¡®è®¤åæ‰åˆ‡æ¢å›ä¸»æœåŠ¡å™¨` | `é‡è¦ç”Ÿäº§ç¯å¢ƒ` | `âœ…ç¨³å®š âŒéœ€è¦äººå·¥å¹²é¢„` |

---

## 5. âš–ï¸ è´Ÿè½½å‡è¡¡å®ç°


### 5.1 Nginxè´Ÿè½½å‡è¡¡é…ç½®


**åŸºç¡€é…ç½®è§£é‡Š**ï¼š

```nginx
# /etc/nginx/conf.d/jenkins.conf
upstream jenkins_cluster {
    # æœåŠ¡å™¨é…ç½®
    server 192.168.1.101:8080 max_fails=3 fail_timeout=30s;
    server 192.168.1.102:8080 max_fails=3 fail_timeout=30s;
    server 192.168.1.103:8080 backup;  # å¤‡ç”¨æœåŠ¡å™¨
    
    # ä¼šè¯ä¿æŒ
    ip_hash;  # åŒä¸€ç”¨æˆ·å§‹ç»ˆè®¿é—®åŒä¸€å°æœåŠ¡å™¨
}

server {
    listen 80;
    server_name jenkins.company.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name jenkins.company.com;
    
    # SSLé…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/private.key;
    
    location / {
        proxy_pass http://jenkins_cluster;
        
        # é‡è¦çš„ä»£ç†å¤´è®¾ç½®
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocketæ”¯æŒï¼ˆJenkins CLIéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
```

### 5.2 è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©


**ç®—æ³•å¯¹æ¯”è¯´æ˜**ï¼š

```
ğŸ”¸ è½®è¯¢(Round Robin)
å·¥ä½œæ–¹å¼ï¼šè¯·æ±‚ä¾æ¬¡åˆ†é…ç»™å„æœåŠ¡å™¨
é€‚ç”¨åœºæ™¯ï¼šæœåŠ¡å™¨é…ç½®ç›¸åŒ
    A â†’ æœåŠ¡å™¨1
    B â†’ æœåŠ¡å™¨2  
    C â†’ æœåŠ¡å™¨3
    D â†’ æœåŠ¡å™¨1 (å¾ªç¯)

ğŸ”¸ IPå“ˆå¸Œ(IP Hash)
å·¥ä½œæ–¹å¼ï¼šæ ¹æ®ç”¨æˆ·IPåˆ†é…å›ºå®šæœåŠ¡å™¨
é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ä¼šè¯ä¿æŒçš„åº”ç”¨
    ç”¨æˆ·192.168.1.50 â†’ å§‹ç»ˆè®¿é—®æœåŠ¡å™¨1
    ç”¨æˆ·192.168.1.60 â†’ å§‹ç»ˆè®¿é—®æœåŠ¡å™¨2

ğŸ”¸ æœ€å°‘è¿æ¥(Least Connections)
å·¥ä½œæ–¹å¼ï¼šåˆ†é…ç»™å½“å‰è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨
é€‚ç”¨åœºæ™¯ï¼šè¯·æ±‚å¤„ç†æ—¶é—´å·®å¼‚å¤§
    æœåŠ¡å™¨1(10ä¸ªè¿æ¥) â† æ–°è¯·æ±‚åˆ†é…åˆ°è¿™é‡Œ
    æœåŠ¡å™¨2(15ä¸ªè¿æ¥)
```

### 5.3 ä¼šè¯ä¿æŒé—®é¢˜


**Jenkinsä¼šè¯ç‰¹ç‚¹**ï¼š
```
ğŸ“Œ ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯ä¿æŒ
â€¢ ç”¨æˆ·ç™»å½•çŠ¶æ€å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­
â€¢ æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶
â€¢ WebSocketè¿æ¥(å®æ—¶æ—¥å¿—æŸ¥çœ‹)

ğŸ”§ è§£å†³æ–¹æ¡ˆ
æ–¹æ¡ˆ1ï¼šSticky Session (IPå“ˆå¸Œ)
  âœ… é…ç½®ç®€å•
  âŒ åˆ†å¸ƒä¸å‡åŒ€

æ–¹æ¡ˆ2ï¼šSessionå…±äº« (Redis)
  âœ… åˆ†å¸ƒå‡åŒ€  
  âŒ éœ€è¦é¢å¤–ç»„ä»¶

æ–¹æ¡ˆ3ï¼šæ— çŠ¶æ€è®¾è®¡
  âœ… æœ€ä½³æ–¹æ¡ˆ
  âŒ æ”¹é€ å·¥ä½œé‡å¤§
```

---

## 6. ğŸ” æœåŠ¡å¥åº·æ£€æŸ¥


### 6.1 å¤šå±‚æ¬¡å¥åº·æ£€æŸ¥


**æ£€æŸ¥ä½“ç³»è®¾è®¡**ï¼š

```
å¥åº·æ£€æŸ¥å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1: åŸºç¡€è®¾æ–½æ£€æŸ¥                    â”‚
â”‚  â€¢ æœåŠ¡å™¨ç¡¬ä»¶çŠ¶æ€                    â”‚
â”‚  â€¢ æ“ä½œç³»ç»Ÿè¿è¡ŒçŠ¶æ€                  â”‚
â”‚  â€¢ ç½‘ç»œè¿é€šæ€§                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L2: åº”ç”¨æœåŠ¡æ£€æŸ¥                    â”‚  
â”‚  â€¢ Jenkinsè¿›ç¨‹çŠ¶æ€                   â”‚
â”‚  â€¢ ç«¯å£ç›‘å¬çŠ¶æ€                      â”‚
â”‚  â€¢ èµ„æºä½¿ç”¨æƒ…å†µ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L3: ä¸šåŠ¡åŠŸèƒ½æ£€æŸ¥                    â”‚
â”‚  â€¢ APIå“åº”æ­£å¸¸                       â”‚
â”‚  â€¢ é¡µé¢è®¿é—®æ­£å¸¸                      â”‚
â”‚  â€¢ æ„å»ºä»»åŠ¡èƒ½æ­£å¸¸æ‰§è¡Œ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 è¯¦ç»†æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# advanced_health_check.sh

LOG_FILE="/var/log/jenkins_health.log"
JENKINS_URL="http://localhost:8080"

log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a $LOG_FILE
}

# L1: åŸºç¡€è®¾æ–½æ£€æŸ¥
check_infrastructure() {
    log_message "å¼€å§‹åŸºç¡€è®¾æ–½æ£€æŸ¥..."
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    DISK_USAGE=$(df -h /var/jenkins_home | awk 'NR==2 {print $5}' | sed 's/%//')
    if [ $DISK_USAGE -gt 85 ]; then
        log_message "è­¦å‘Š: ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜ ($DISK_USAGE%)"
        return 1
    fi
    
    # æ£€æŸ¥å†…å­˜ä½¿ç”¨
    MEM_USAGE=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
    if [ $MEM_USAGE -gt 90 ]; then
        log_message "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ($MEM_USAGE%)"
        return 1
    fi
    
    log_message "åŸºç¡€è®¾æ–½æ£€æŸ¥é€šè¿‡"
    return 0
}

# L2: åº”ç”¨æœåŠ¡æ£€æŸ¥  
check_application() {
    log_message "å¼€å§‹åº”ç”¨æœåŠ¡æ£€æŸ¥..."
    
    # æ£€æŸ¥Jenkinsè¿›ç¨‹
    if ! pgrep -f "jenkins.war" > /dev/null; then
        log_message "é”™è¯¯: Jenkinsè¿›ç¨‹æœªè¿è¡Œ"
        return 1
    fi
    
    # æ£€æŸ¥ç«¯å£ç›‘å¬
    if ! netstat -tlnp | grep -q ":8080.*LISTEN"; then
        log_message "é”™è¯¯: Jenkinsç«¯å£8080æœªç›‘å¬"
        return 1
    fi
    
    log_message "åº”ç”¨æœåŠ¡æ£€æŸ¥é€šè¿‡"
    return 0
}

# L3: ä¸šåŠ¡åŠŸèƒ½æ£€æŸ¥
check_business() {
    log_message "å¼€å§‹ä¸šåŠ¡åŠŸèƒ½æ£€æŸ¥..."
    
    # æ£€æŸ¥é¦–é¡µè®¿é—®
    if ! curl -s --max-time 10 "$JENKINS_URL" | grep -q "Jenkins"; then
        log_message "é”™è¯¯: Jenkinsé¦–é¡µæ— æ³•è®¿é—®"
        return 1
    fi
    
    # æ£€æŸ¥APIå“åº”
    API_RESPONSE=$(curl -s --max-time 10 "$JENKINS_URL/api/json")
    if ! echo "$API_RESPONSE" | grep -q '"_class"'; then
        log_message "é”™è¯¯: Jenkins APIå“åº”å¼‚å¸¸"
        return 1
    fi
    
    log_message "ä¸šåŠ¡åŠŸèƒ½æ£€æŸ¥é€šè¿‡"
    return 0
}

# ä¸»æ£€æŸ¥æµç¨‹
main() {
    log_message "=== å¼€å§‹Jenkinså¥åº·æ£€æŸ¥ ==="
    
    if check_infrastructure && check_application && check_business; then
        log_message "=== JenkinsæœåŠ¡å®Œå…¨æ­£å¸¸ ==="
        exit 0
    else
        log_message "=== JenkinsæœåŠ¡å­˜åœ¨é—®é¢˜ ==="
        exit 1
    fi
}

main "$@"
```

### 6.3 ç›‘æ§å‘Šè­¦é›†æˆ


**Prometheusç›‘æ§é…ç½®**ï¼š

```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'jenkins'
    static_configs:
      - targets: ['jenkins1:8080', 'jenkins2:8080']
    metrics_path: '/prometheus'
    scrape_interval: 10s

rule_files:
  - "jenkins_alerts.yml"
```

**å‘Šè­¦è§„åˆ™ç¤ºä¾‹**ï¼š
```yaml
# jenkins_alerts.yml
groups:
- name: jenkins_alerts
  rules:
  - alert: JenkinsDown
    expr: up{job="jenkins"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "JenkinsæœåŠ¡ä¸‹çº¿"
      description: "Jenkinså®ä¾‹ {{ $labels.instance }} å·²ä¸‹çº¿è¶…è¿‡1åˆ†é’Ÿ"
      
  - alert: JenkinsHighMemory
    expr: jenkins_memory_usage_ratio > 0.9
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Jenkinså†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
      description: "Jenkinså®ä¾‹ {{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡ä¸º {{ $value }}%"
```

---

## 7. ğŸ›¡ï¸ å®¹ç¾å¤‡ä»½æ–¹æ¡ˆ


### 7.1 å¤‡ä»½ç­–ç•¥è®¾è®¡


**3-2-1å¤‡ä»½åŸåˆ™**ï¼š
```
ğŸ“Š å¤‡ä»½ç­–ç•¥è¯´æ˜
3ä»½æ•°æ®ï¼šåŸå§‹æ•°æ® + 2ä»½å¤‡ä»½
2ç§åª’ä»‹ï¼šæœ¬åœ°å­˜å‚¨ + äº‘å­˜å‚¨  
1ä»½å¼‚åœ°ï¼šé˜²èŒƒåŒºåŸŸæ€§ç¾éš¾

å®æ–½æ–¹æ¡ˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®   â”‚ æœ¬åœ°å¤‡ä»½ â”‚ åŒåŸå¤‡ä»½ â”‚ å¼‚åœ°å¤‡ä»½ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é…ç½®æ–‡ä»¶ â”‚   âœ…     â”‚   âœ…     â”‚   âœ…     â”‚
â”‚  æ„å»ºå†å² â”‚   âœ…     â”‚   âœ…     â”‚   âŒ     â”‚
â”‚  æºä»£ç    â”‚   Git    â”‚   Git    â”‚   Git    â”‚
â”‚  æ„å»ºäº§ç‰© â”‚   âœ…     â”‚   âŒ     â”‚   âŒ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬


```bash
#!/bin/bash
# jenkins_backup.sh

# é…ç½®å˜é‡
JENKINS_HOME="/var/jenkins_home"
BACKUP_DIR="/backup/jenkins"
REMOTE_BACKUP="s3://company-backup/jenkins"
RETENTION_DAYS=30

# åˆ›å»ºå¤‡ä»½ç›®å½•
BACKUP_DATE=$(date +%Y%m%d_%H%M%S)
CURRENT_BACKUP="$BACKUP_DIR/$BACKUP_DATE"
mkdir -p "$CURRENT_BACKUP"

log_backup() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a "$BACKUP_DIR/backup.log"
}

# å¤‡ä»½Jenkinsé…ç½®
backup_jenkins_config() {
    log_backup "å¼€å§‹å¤‡ä»½Jenkinsé…ç½®..."
    
    # å¤‡ä»½é‡è¦ç›®å½•
    tar -czf "$CURRENT_BACKUP/jenkins_config.tar.gz" \
        --exclude="$JENKINS_HOME/workspace" \
        --exclude="$JENKINS_HOME/builds/*/workspace" \
        --exclude="$JENKINS_HOME/logs" \
        "$JENKINS_HOME"
    
    if [ $? -eq 0 ]; then
        log_backup "Jenkinsé…ç½®å¤‡ä»½å®Œæˆ"
        return 0
    else
        log_backup "Jenkinsé…ç½®å¤‡ä»½å¤±è´¥"
        return 1
    fi
}

# å¤‡ä»½æ•°æ®åº“
backup_database() {
    if [ -n "$POSTGRES_HOST" ]; then
        log_backup "å¼€å§‹å¤‡ä»½æ•°æ®åº“..."
        
        pg_dump -h "$POSTGRES_HOST" -U "$POSTGRES_USER" \
                -d "$POSTGRES_DB" > "$CURRENT_BACKUP/jenkins_db.sql"
        
        if [ $? -eq 0 ]; then
            log_backup "æ•°æ®åº“å¤‡ä»½å®Œæˆ"
            return 0
        else
            log_backup "æ•°æ®åº“å¤‡ä»½å¤±è´¥"
            return 1
        fi
    fi
}

# ä¸Šä¼ åˆ°äº‘å­˜å‚¨
upload_to_cloud() {
    log_backup "å¼€å§‹ä¸Šä¼ åˆ°äº‘å­˜å‚¨..."
    
    aws s3 sync "$CURRENT_BACKUP" "$REMOTE_BACKUP/$BACKUP_DATE/"
    
    if [ $? -eq 0 ]; then
        log_backup "äº‘å­˜å‚¨ä¸Šä¼ å®Œæˆ"
        return 0
    else
        log_backup "äº‘å­˜å‚¨ä¸Šä¼ å¤±è´¥"
        return 1
    fi
}

# æ¸…ç†è¿‡æœŸå¤‡ä»½
cleanup_old_backups() {
    log_backup "å¼€å§‹æ¸…ç†è¿‡æœŸå¤‡ä»½..."
    
    # åˆ é™¤æœ¬åœ°è¿‡æœŸå¤‡ä»½
    find "$BACKUP_DIR" -maxdepth 1 -type d -mtime +$RETENTION_DAYS -exec rm -rf {} \;
    
    # åˆ é™¤äº‘å­˜å‚¨è¿‡æœŸå¤‡ä»½
    aws s3 ls "$REMOTE_BACKUP/" | \
    awk '$1 <= "'$(date -d "$RETENTION_DAYS days ago" +%Y-%m-%d)'" {print $4}' | \
    xargs -I {} aws s3 rm --recursive "$REMOTE_BACKUP/{}"
    
    log_backup "è¿‡æœŸå¤‡ä»½æ¸…ç†å®Œæˆ"
}

# ä¸»å¤‡ä»½æµç¨‹
main() {
    log_backup "=== å¼€å§‹Jenkinså¤‡ä»½ä»»åŠ¡ ==="
    
    if backup_jenkins_config && backup_database; then
        if upload_to_cloud; then
            cleanup_old_backups
            log_backup "=== å¤‡ä»½ä»»åŠ¡å…¨éƒ¨å®Œæˆ ==="
            exit 0
        else
            log_backup "=== å¤‡ä»½ä»»åŠ¡éƒ¨åˆ†å¤±è´¥ï¼ˆä¸Šä¼ å¤±è´¥ï¼‰==="
            exit 1
        fi
    else
        log_backup "=== å¤‡ä»½ä»»åŠ¡å¤±è´¥ ==="
        exit 1
    fi
}

main "$@"
```

### 7.3 ç¾éš¾æ¢å¤æµç¨‹


**æ¢å¤æ“ä½œæ­¥éª¤**ï¼š

```
ğŸš¨ ç¾éš¾æ¢å¤SOP (æ ‡å‡†æ“ä½œç¨‹åº)

Phase 1: è¯„ä¼°ä¸å‡†å¤‡ (10-15åˆ†é’Ÿ)
â”œâ”€ ç¡®è®¤æ•…éšœèŒƒå›´å’Œå½±å“
â”œâ”€ å¯åŠ¨åº”æ€¥å“åº”å›¢é˜Ÿ
â”œâ”€ å‡†å¤‡å¤‡ç”¨ç¯å¢ƒ
â””â”€ ç¡®è®¤æœ€æ–°å¯ç”¨å¤‡ä»½

Phase 2: åŸºç¡€ç¯å¢ƒæ¢å¤ (20-30åˆ†é’Ÿ)  
â”œâ”€ éƒ¨ç½²JenkinsæœåŠ¡å™¨
â”œâ”€ é…ç½®ç½‘ç»œå’Œå®‰å…¨ç»„
â”œâ”€ å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…
â””â”€ æ¢å¤ç³»ç»Ÿé…ç½®

Phase 3: æ•°æ®æ¢å¤ (30-60åˆ†é’Ÿ)
â”œâ”€ æ¢å¤Jenkinsé…ç½®æ–‡ä»¶
â”œâ”€ æ¢å¤æ•°æ®åº“æ•°æ®
â”œâ”€ æ¢å¤æ’ä»¶å’Œå¯†é’¥
â””â”€ éªŒè¯æ•°æ®å®Œæ•´æ€§

Phase 4: æœåŠ¡éªŒè¯ (15-20åˆ†é’Ÿ)
â”œâ”€ å¯åŠ¨JenkinsæœåŠ¡
â”œâ”€ éªŒè¯åŸºæœ¬åŠŸèƒ½
â”œâ”€ æµ‹è¯•å…³é”®ä»»åŠ¡
â””â”€ ç¡®è®¤æ¢å¤å®Œæˆ

æ€»æ¢å¤æ—¶é—´ç›®æ ‡: < 2å°æ—¶
```

**è‡ªåŠ¨åŒ–æ¢å¤è„šæœ¬**ï¼š

```bash
#!/bin/bash
# jenkins_restore.sh

BACKUP_SOURCE="$1"
JENKINS_HOME="/var/jenkins_home"

if [ -z "$BACKUP_SOURCE" ]; then
    echo "ç”¨æ³•: $0 <å¤‡ä»½æ–‡ä»¶è·¯å¾„>"
    exit 1
fi

# åœæ­¢JenkinsæœåŠ¡
systemctl stop jenkins

# æ¸…ç©ºç°æœ‰æ•°æ®
rm -rf "$JENKINS_HOME"/*

# æ¢å¤é…ç½®æ–‡ä»¶
tar -xzf "$BACKUP_SOURCE/jenkins_config.tar.gz" -C /

# æ¢å¤æ•°æ®åº“ï¼ˆå¦‚æœæœ‰ï¼‰
if [ -f "$BACKUP_SOURCE/jenkins_db.sql" ]; then
    psql -h "$POSTGRES_HOST" -U "$POSTGRES_USER" \
         -d "$POSTGRES_DB" < "$BACKUP_SOURCE/jenkins_db.sql"
fi

# è®¾ç½®æƒé™
chown -R jenkins:jenkins "$JENKINS_HOME"

# å¯åŠ¨JenkinsæœåŠ¡
systemctl start jenkins

echo "Jenkinsæ¢å¤å®Œæˆï¼Œè¯·éªŒè¯æœåŠ¡çŠ¶æ€"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ é«˜å¯ç”¨æœ¬è´¨ï¼šé€šè¿‡å†—ä½™è®¾è®¡é¿å…å•ç‚¹æ•…éšœï¼Œç¡®ä¿æœåŠ¡æŒç»­å¯ç”¨
ğŸ”¸ é›†ç¾¤æ¶æ„ï¼šä¸»ä»æ¨¡å¼æ˜¯æœ€å®ç”¨çš„æ–¹æ¡ˆï¼ŒActive-Passiveç®€å•å¯é 
ğŸ”¸ æ•°æ®åŒæ­¥ï¼šå…±äº«å­˜å‚¨æ˜¯å…³é”®ï¼ŒNFSç®€å•ä½†è¦è€ƒè™‘æ€§èƒ½ç“¶é¢ˆ  
ğŸ”¸ æ•…éšœè½¬ç§»ï¼šKeepalived+è™šæ‹ŸIPæ˜¯ç»å…¸æ–¹æ¡ˆï¼Œåˆ‡æ¢æ—¶é—´10-30ç§’
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šNginxé…ç½®ç®€å•ï¼ŒIPå“ˆå¸Œè§£å†³ä¼šè¯ä¿æŒé—®é¢˜
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šå¤šå±‚æ¬¡æ£€æŸ¥æ›´å¯é ï¼Œä»åŸºç¡€è®¾æ–½åˆ°ä¸šåŠ¡åŠŸèƒ½
ğŸ”¸ å¤‡ä»½æ¢å¤ï¼š3-2-1åŸåˆ™ï¼Œè‡ªåŠ¨åŒ–å¤‡ä»½ï¼Œç¾éš¾æ¢å¤é¢„æ¡ˆå¿…ä¸å¯å°‘
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆé€‰æ‹©ä¸»ä»æ¶æ„**
```
æŠ€æœ¯æˆç†Ÿåº¦ï¼š
â€¢ æ–¹æ¡ˆç®€å•ï¼Œå®¹æ˜“ç†è§£å’Œå®æ–½
â€¢ å¤§é‡ç”Ÿäº§ç¯å¢ƒéªŒè¯è¿‡çš„å¯é æ€§
â€¢ ç¤¾åŒºæ”¯æŒä¸°å¯Œï¼Œé—®é¢˜å®¹æ˜“è§£å†³

èµ„æºå¹³è¡¡ï¼š
â€¢ ç›¸æ¯”åŒæ´»æ¨¡å¼ï¼Œå¤æ‚åº¦å’Œæˆæœ¬æ›´ä½
â€¢ ç›¸æ¯”å•ç‚¹éƒ¨ç½²ï¼Œå¯é æ€§å¤§å¹…æå‡
â€¢ é€‚åˆä¸­å°å›¢é˜Ÿçš„æŠ€æœ¯èƒ½åŠ›å’Œé¢„ç®—
```

**ğŸ”¹ æ•°æ®åŒæ­¥çš„æ ¸å¿ƒæŒ‘æˆ˜**
```
ä¸€è‡´æ€§è¦æ±‚ï¼š
â€¢ Jenkinsé…ç½®å¿…é¡»å®Œå…¨ä¸€è‡´
â€¢ æ„å»ºå†å²æ•°æ®è¦æ±‚å®Œæ•´
â€¢ ç”¨æˆ·æƒé™å’Œå¯†é’¥ä¸èƒ½ä¸¢å¤±

æ€§èƒ½å½±å“ï¼š
â€¢ å…±äº«å­˜å‚¨å¯èƒ½æˆä¸ºç“¶é¢ˆ
â€¢ ç½‘ç»œå»¶è¿Ÿå½±å“å“åº”é€Ÿåº¦
â€¢ éœ€è¦åœ¨ä¸€è‡´æ€§å’Œæ€§èƒ½é—´å¹³è¡¡
```

**ğŸ”¹ æ•…éšœè½¬ç§»çš„å…³é”®æŒ‡æ ‡**
```
RTO (æ¢å¤æ—¶é—´ç›®æ ‡): ç³»ç»Ÿæ•…éšœåå¤šä¹…èƒ½æ¢å¤æœåŠ¡
â€¢ è‡ªåŠ¨æ•…éšœè½¬ç§»: 10-30ç§’
â€¢ æ‰‹åŠ¨æ•…éšœè½¬ç§»: 5-15åˆ†é’Ÿ

RPO (æ¢å¤ç‚¹ç›®æ ‡): èƒ½æ¥å—ä¸¢å¤±å¤šå°‘æ•°æ®
â€¢ å®æ—¶åŒæ­¥: å‡ ä¹æ— æ•°æ®ä¸¢å¤±
â€¢ å®šæœŸåŒæ­¥: å¯èƒ½ä¸¢å¤±æœ€è¿‘å‡ åˆ†é’Ÿæ•°æ®
```

### 8.3 å®æ–½å»ºè®®å’Œæœ€ä½³å®è·µ


**ğŸ¯ åˆ†é˜¶æ®µå®æ–½ç­–ç•¥**
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€é«˜å¯ç”¨
â€¢ æ­å»ºä¸»ä»æ¶æ„
â€¢ é…ç½®è‡ªåŠ¨å¤‡ä»½
â€¢ å®ç°åŸºæœ¬çš„æ•…éšœè½¬ç§»

ç¬¬äºŒé˜¶æ®µï¼šå®Œå–„ç›‘æ§
â€¢ éƒ¨ç½²å¥åº·æ£€æŸ¥
â€¢ æ¥å…¥ç›‘æ§å‘Šè­¦
â€¢ åˆ¶å®šè¿ç»´è§„èŒƒ

ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–æ€§èƒ½
â€¢ è´Ÿè½½å‡è¡¡ä¼˜åŒ–
â€¢ å­˜å‚¨æ€§èƒ½è°ƒä¼˜
â€¢ æ‰©å±•AgentèŠ‚ç‚¹
```

**ğŸ”§ è¿ç»´æ³¨æ„äº‹é¡¹**
```
æ—¥å¸¸ç»´æŠ¤ï¼š
â€¢ å®šæœŸæµ‹è¯•æ•…éšœè½¬ç§»
â€¢ éªŒè¯å¤‡ä»½å¯ç”¨æ€§
â€¢ ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
â€¢ æ›´æ–°å’Œæ‰“è¡¥ä¸

åº”æ€¥å‡†å¤‡ï¼š
â€¢ å»ºç«‹æ•…éšœå“åº”æµç¨‹
â€¢ åŸ¹è®­è¿ç»´äººå‘˜
â€¢ å‡†å¤‡åº”æ€¥è”ç³»æ–¹å¼
â€¢ åˆ¶å®šå›æ»šæ–¹æ¡ˆ
```

**ğŸ“Š æˆæœ¬æ•ˆç›Šåˆ†æ**
```
æŠ•å…¥æˆæœ¬ï¼š
â€¢ ç¡¬ä»¶æˆæœ¬ï¼šå¢åŠ 1-2å€æœåŠ¡å™¨
â€¢ äººåŠ›æˆæœ¬ï¼šæ¶æ„è®¾è®¡å’Œè¿ç»´
â€¢ æ—¶é—´æˆæœ¬ï¼šåˆæœŸæ­å»ºå’Œè°ƒè¯•

æ”¶ç›Šä»·å€¼ï¼š
â€¢ å¯ç”¨æ€§æå‡ï¼šä»95%åˆ°99.9%
â€¢ æ•…éšœå½±å“ï¼šä»å°æ—¶çº§é™åˆ°åˆ†é’Ÿçº§
â€¢ å›¢é˜Ÿæ•ˆç‡ï¼šé¿å…å› æœåŠ¡ä¸­æ–­å½±å“å¼€å‘
â€¢ ä¸šåŠ¡è¿ç»­æ€§ï¼šç¡®ä¿CI/CDæµç¨‹ä¸ä¸­æ–­
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**ğŸ” æ•…éšœæ’æŸ¥æ€è·¯**
```
é—®é¢˜åˆ†å±‚å®šä½ï¼š
Layer 1: ç½‘ç»œè¿é€šæ€§ â†’ pingã€telnetæµ‹è¯•
Layer 2: æœåŠ¡çŠ¶æ€ â†’ è¿›ç¨‹ã€ç«¯å£æ£€æŸ¥  
Layer 3: åº”ç”¨åŠŸèƒ½ â†’ APIè°ƒç”¨ã€é¡µé¢è®¿é—®
Layer 4: ä¸šåŠ¡é€»è¾‘ â†’ æ„å»ºä»»åŠ¡ã€æ’ä»¶åŠŸèƒ½

å·¥å…·æ¨èï¼š
â€¢ ç½‘ç»œï¼šping, traceroute, nmap
â€¢ ç³»ç»Ÿï¼šhtop, iotop, netstat
â€¢ åº”ç”¨ï¼šcurl, jenkins-cli
â€¢ æ—¥å¿—ï¼štail, grep, journalctl
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Jenkinsé«˜å¯ç”¨ = å†—ä½™è®¾è®¡ + è‡ªåŠ¨åˆ‡æ¢ + æ•°æ®åŒæ­¥
- ä¸»ä»æ¶æ„ç®€å•å¯é ï¼Œæ˜¯ä¸­å°å›¢é˜Ÿçš„æœ€ä½³é€‰æ‹©
- æ•…éšœè½¬ç§»è¦å¿«ï¼ˆç§’çº§ï¼‰ï¼Œæ•°æ®å¤‡ä»½è¦å…¨ï¼ˆå®šæœŸéªŒè¯ï¼‰
- ç›‘æ§å‘Šè­¦ä¸èƒ½å°‘ï¼Œè¿ç»´è§„èŒƒè¦å»ºç«‹
- å…ˆæ±‚ç¨³å®šå¯ç”¨ï¼Œå†è¿½æ±‚æ€§èƒ½ä¼˜åŒ–