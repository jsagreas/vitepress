---
title: 1ã€Java Webé¡¹ç›®å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [Java Webé¡¹ç›®CI/CDæ¦‚è¿°](#1-Java-Webé¡¹ç›®CICDæ¦‚è¿°)
2. [Spring Booté¡¹ç›®CI/CDå®æˆ˜](#2-Spring-Booté¡¹ç›®CICDå®æˆ˜)
3. [Mavenæ„å»ºé…ç½®è¯¦è§£](#3-Mavenæ„å»ºé…ç½®è¯¦è§£)
4. [å•å…ƒæµ‹è¯•é›†æˆå®ç°](#4-å•å…ƒæµ‹è¯•é›†æˆå®ç°)
5. [Dockeréƒ¨ç½²å®ç°](#5-Dockeréƒ¨ç½²å®ç°)
6. [æ•°æ®åº“è¿ç§»å¤„ç†](#6-æ•°æ®åº“è¿ç§»å¤„ç†)
7. [å®Œæ•´Pipelineç¤ºä¾‹](#7-å®Œæ•´Pipelineç¤ºä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Java Webé¡¹ç›®CI/CDæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Java Webé¡¹ç›®CI/CD


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ åœ¨å¼€å‘ä¸€ä¸ªç½‘ä¸Šå•†åŸç³»ç»Ÿï¼Œæ¯æ¬¡ä¿®æ”¹ä»£ç åéƒ½è¦æ‰‹åŠ¨ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚CI/CDå°±æ˜¯è®©æœºå™¨è‡ªåŠ¨å®Œæˆè¿™äº›é‡å¤å·¥ä½œçš„"æ™ºèƒ½åŠ©æ‰‹"ã€‚

```
ä¼ ç»Ÿå¼€å‘æµç¨‹ï¼š
å¼€å‘è€…å†™ä»£ç  â†’ æ‰‹åŠ¨ç¼–è¯‘ â†’ æ‰‹åŠ¨æµ‹è¯• â†’ æ‰‹åŠ¨æ‰“åŒ… â†’ æ‰‹åŠ¨éƒ¨ç½²
é—®é¢˜ï¼šå®¹æ˜“å‡ºé”™ã€æ•ˆç‡ä½ã€é‡å¤åŠ³åŠ¨å¤š

CI/CDè‡ªåŠ¨åŒ–æµç¨‹ï¼š
å¼€å‘è€…æäº¤ä»£ç  â†’ Jenkinsè‡ªåŠ¨ç¼–è¯‘ â†’ è‡ªåŠ¨æµ‹è¯• â†’ è‡ªåŠ¨æ‰“åŒ… â†’ è‡ªåŠ¨éƒ¨ç½²
ä¼˜åŠ¿ï¼šå‡å°‘é”™è¯¯ã€æé«˜æ•ˆç‡ã€æ ‡å‡†åŒ–æµç¨‹
```

### 1.2 Java Webé¡¹ç›®çš„ç‰¹ç‚¹


**ğŸ”¸ æŠ€æœ¯æ ˆå¤æ‚**
- **å‰ç«¯**ï¼šHTMLã€CSSã€JavaScriptã€Vue/Reactç­‰
- **åç«¯**ï¼šJavaã€Spring Bootã€MyBatisç­‰
- **æ•°æ®åº“**ï¼šMySQLã€Redisç­‰
- **æ„å»ºå·¥å…·**ï¼šMavenæˆ–Gradle

**ğŸ”¸ éƒ¨ç½²ç¯å¢ƒå¤šæ ·**
- **å¼€å‘ç¯å¢ƒ**ï¼šæœ¬åœ°å¼€å‘è°ƒè¯•
- **æµ‹è¯•ç¯å¢ƒ**ï¼šåŠŸèƒ½æµ‹è¯•éªŒè¯
- **é¢„å‘å¸ƒç¯å¢ƒ**ï¼šæœ€ç»ˆéªŒè¯
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šç”¨æˆ·å®é™…ä½¿ç”¨

### 1.3 CI/CDè§£å†³çš„æ ¸å¿ƒé—®é¢˜


**é—®é¢˜1ï¼šç¯å¢ƒä¸ä¸€è‡´**
```
ç°è±¡ï¼šæœ¬åœ°èƒ½è·‘ï¼ŒæœåŠ¡å™¨æŠ¥é”™
åŸå› ï¼šJavaç‰ˆæœ¬ã€ä¾èµ–ç‰ˆæœ¬ã€é…ç½®æ–‡ä»¶ä¸åŒ
è§£å†³ï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œç¯å¢ƒæ ‡å‡†åŒ–
```

**é—®é¢˜2ï¼šéƒ¨ç½²å¤æ‚ç¹ç**
```
ä¼ ç»Ÿéƒ¨ç½²æ­¥éª¤ï¼š
1. æ‰“åŒ…war/jaræ–‡ä»¶
2. åœæ­¢æœåŠ¡å™¨
3. å¤‡ä»½æ—§ç‰ˆæœ¬
4. ä¸Šä¼ æ–°æ–‡ä»¶
5. ä¿®æ”¹é…ç½®
6. å¯åŠ¨æœåŠ¡å™¨
7. éªŒè¯åŠŸèƒ½

CI/CDè‡ªåŠ¨åŒ–åï¼šä¸€é”®éƒ¨ç½²å®Œæˆæ‰€æœ‰æ­¥éª¤
```

**é—®é¢˜3ï¼šé”™è¯¯å‘ç°æ™š**
```
ä¼ ç»Ÿæ¨¡å¼ï¼šä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯æ‰å‘ç°å†²çª
CI/CDæ¨¡å¼ï¼šæ¯æ¬¡æäº¤éƒ½è‡ªåŠ¨æ£€æŸ¥ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
```

---

## 2. ğŸš€ Spring Booté¡¹ç›®CI/CDå®æˆ˜


### 2.1 é¡¹ç›®ç»“æ„å‡†å¤‡


**æ ‡å‡†Spring Booté¡¹ç›®ç»“æ„**ï¼š
```
mall-system/                    â† é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/              â† Javaæºç 
â”‚   â”‚   â”‚   â””â”€â”€ com/example/mall/
â”‚   â”‚   â”‚       â”œâ”€â”€ MallApplication.java
â”‚   â”‚   â”‚       â”œâ”€â”€ controller/  â† æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚       â”œâ”€â”€ service/     â† ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚       â””â”€â”€ dao/         â† æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â””â”€â”€ resources/         â† é…ç½®æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ application.yml
â”‚   â”‚       â””â”€â”€ static/        â† é™æ€èµ„æº
â”‚   â””â”€â”€ test/                  â† æµ‹è¯•ä»£ç 
â”‚       â””â”€â”€ java/
â”œâ”€â”€ Dockerfile                 â† Dockeré•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ pom.xml                    â† Mavené…ç½®æ–‡ä»¶
â””â”€â”€ Jenkinsfile               â† Jenkinsæµæ°´çº¿é…ç½®
```

### 2.2 æ ¸å¿ƒé…ç½®æ–‡ä»¶è§£é‡Š


**ğŸ”¸ application.ymlï¼ˆåº”ç”¨é…ç½®ï¼‰**
```yaml
# æ•°æ®åº“è¿æ¥é…ç½®
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mall?useUnicode=true&characterEncoding=utf8
    username: ${DB_USERNAME:root}      # æ”¯æŒç¯å¢ƒå˜é‡ï¼Œé»˜è®¤å€¼root
    password: ${DB_PASSWORD:123456}    # æ”¯æŒç¯å¢ƒå˜é‡ï¼Œé»˜è®¤å€¼123456
  
  # JPAé…ç½®ï¼ˆæ“ä½œæ•°æ®åº“çš„æ¡†æ¶ï¼‰
  jpa:
    hibernate:
      ddl-auto: update                 # è‡ªåŠ¨æ›´æ–°æ•°æ®åº“è¡¨ç»“æ„
    show-sql: true                     # æ˜¾ç¤ºSQLè¯­å¥ï¼Œä¾¿äºè°ƒè¯•

# æœåŠ¡å™¨ç«¯å£é…ç½®
server:
  port: ${SERVER_PORT:8080}           # æ”¯æŒç¯å¢ƒå˜é‡ï¼Œé»˜è®¤8080ç«¯å£

# æ—¥å¿—é…ç½®
logging:
  level:
    com.example.mall: ${LOG_LEVEL:INFO}  # åº”ç”¨æ—¥å¿—çº§åˆ«
```

> ğŸ’¡ **ç¯å¢ƒå˜é‡çš„ä½œç”¨**ï¼š`${DB_USERNAME:root}`è¡¨ç¤ºä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡DB_USERNAMEï¼Œå¦‚æœæ²¡æœ‰å°±ç”¨é»˜è®¤å€¼rootã€‚è¿™æ ·åœ¨ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰å¯ä»¥ä½¿ç”¨ä¸åŒçš„é…ç½®ã€‚

### 2.3 Spring Bootåº”ç”¨ä¸»ç±»


```java
@SpringBootApplication
@EnableJpaRepositories  // å¯ç”¨JPAæ•°æ®è®¿é—®
public class MallApplication {
    public static void main(String[] args) {
        SpringApplication.run(MallApplication.class, args);
        System.out.println("å•†åŸç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼è®¿é—®åœ°å€ï¼šhttp://localhost:8080");
    }
}
```

**è§£é‡Š**ï¼š
- `@SpringBootApplication`ï¼šå‘Šè¯‰Springè¿™æ˜¯ä¸»ç¨‹åºç±»
- `@EnableJpaRepositories`ï¼šå¯ç”¨æ•°æ®åº“æ“ä½œåŠŸèƒ½
- `main`æ–¹æ³•ï¼šç¨‹åºå…¥å£ï¼Œå¯åŠ¨æ•´ä¸ªåº”ç”¨

### 2.4 ç®€å•çš„æ§åˆ¶å™¨ç¤ºä¾‹


```java
@RestController  // è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªREST APIæ§åˆ¶å™¨
@RequestMapping("/api/products")  // æ‰€æœ‰æ¥å£éƒ½ä»¥/api/productså¼€å¤´
public class ProductController {
    
    @Autowired
    private ProductService productService;  // æ³¨å…¥ä¸šåŠ¡é€»è¾‘å±‚
    
    // è·å–å•†å“åˆ—è¡¨çš„æ¥å£
    @GetMapping("/list")
    public ResponseEntity<?> getProductList() {
        try {
            List<Product> products = productService.getAllProducts();
            return ResponseEntity.ok(products);  // è¿”å›æˆåŠŸç»“æœ
        } catch (Exception e) {
            return ResponseEntity.status(500)
                .body("è·å–å•†å“åˆ—è¡¨å¤±è´¥ï¼š" + e.getMessage());
        }
    }
    
    // å¥åº·æ£€æŸ¥æ¥å£ï¼ˆCI/CDéƒ¨ç½²åéªŒè¯ç”¨ï¼‰
    @GetMapping("/health")
    public Map<String, String> health() {
        Map<String, String> status = new HashMap<>();
        status.put("status", "UP");
        status.put("timestamp", new Date().toString());
        return status;
    }
}
```

**æ¥å£è¯´æ˜**ï¼š
- `/api/products/list`ï¼šè·å–å•†å“åˆ—è¡¨
- `/api/products/health`ï¼šå¥åº·æ£€æŸ¥ï¼ŒCI/CDéƒ¨ç½²åå¯ä»¥è®¿é—®è¿™ä¸ªæ¥å£éªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸

---

## 3. ğŸ› ï¸ Mavenæ„å»ºé…ç½®è¯¦è§£


### 3.1 MavenåŸºç¡€æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯Maven**ï¼šMavenå°±åƒæ˜¯Javaé¡¹ç›®çš„"é¡¹ç›®ç®¡ç†å™¨"ï¼Œå®ƒå¸®ä½ åšä¸‰ä»¶äº‹ï¼š
1. **ä¾èµ–ç®¡ç†**ï¼šè‡ªåŠ¨ä¸‹è½½é¡¹ç›®éœ€è¦çš„jaråŒ…ï¼ˆæ¯”å¦‚Springæ¡†æ¶ï¼‰
2. **é¡¹ç›®æ„å»º**ï¼šç¼–è¯‘ä»£ç ã€è¿è¡Œæµ‹è¯•ã€æ‰“åŒ…éƒ¨ç½²
3. **é¡¹ç›®è§„èŒƒ**ï¼šç»Ÿä¸€é¡¹ç›®ç»“æ„å’Œæ„å»ºæµç¨‹

### 3.2 æ ¸å¿ƒpom.xmlé…ç½®


```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    
    <!-- é¡¹ç›®åŸºæœ¬ä¿¡æ¯ -->
    <groupId>com.example</groupId>           <!-- å…¬å¸/ç»„ç»‡æ ‡è¯† -->
    <artifactId>mall-system</artifactId>     <!-- é¡¹ç›®åç§° -->
    <version>1.0.0</version>                 <!-- ç‰ˆæœ¬å· -->
    <packaging>jar</packaging>               <!-- æ‰“åŒ…æ–¹å¼ï¼šjaræˆ–war -->
    
    <!-- Spring Bootçˆ¶é¡¹ç›®ï¼ˆæä¾›ç‰ˆæœ¬ç®¡ç†ï¼‰ -->
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.0</version>
    </parent>
    
    <!-- é¡¹ç›®å±æ€§é…ç½® -->
    <properties>
        <java.version>11</java.version>      <!-- Javaç‰ˆæœ¬ -->
        <maven.compiler.source>11</maven.compiler.source>
        <maven.compiler.target>11</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    </properties>
    
    <!-- ä¾èµ–ç®¡ç†ï¼ˆé¡¹ç›®éœ€è¦çš„jaråŒ…ï¼‰ -->
    <dependencies>
        <!-- Spring Boot Web starterï¼ˆæä¾›WebåŠŸèƒ½ï¼‰ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- Spring Boot JPA starterï¼ˆæ•°æ®åº“æ“ä½œï¼‰ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        
        <!-- MySQLæ•°æ®åº“é©±åŠ¨ -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <scope>runtime</scope>
        </dependency>
        
        <!-- æµ‹è¯•ç›¸å…³ä¾èµ– -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
    
    <!-- æ„å»ºé…ç½® -->
    <build>
        <!-- æœ€ç»ˆç”Ÿæˆçš„jaråŒ…åç§° -->
        <finalName>${project.artifactId}-${project.version}</finalName>
        
        <plugins>
            <!-- Spring Bootæ‰“åŒ…æ’ä»¶ -->
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <!-- å¯æ‰§è¡ŒjaråŒ… -->
                    <executable>true</executable>
                </configuration>
            </plugin>
            
            <!-- Surefireæµ‹è¯•æ’ä»¶ -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <configuration>
                    <!-- æµ‹è¯•å¤±è´¥ä¸åœæ­¢æ„å»º -->
                    <testFailureIgnore>false</testFailureIgnore>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

### 3.3 Mavenç”Ÿå‘½å‘¨æœŸç†è§£


**Mavenæ„å»ºçš„æ ‡å‡†æµç¨‹**ï¼š
```
1. validate    â†’ éªŒè¯é¡¹ç›®ç»“æ„æ­£ç¡®æ€§
2. compile     â†’ ç¼–è¯‘æºä»£ç 
3. test        â†’ è¿è¡Œå•å…ƒæµ‹è¯•
4. package     â†’ æ‰“åŒ…æˆjar/waræ–‡ä»¶
5. verify      â†’ éªŒè¯æ‰“åŒ…ç»“æœ
6. install     â†’ å®‰è£…åˆ°æœ¬åœ°ä»“åº“
7. deploy      â†’ å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“
```

**å¸¸ç”¨Mavenå‘½ä»¤**ï¼š
- `mvn clean`ï¼šæ¸…ç†ä¹‹å‰çš„æ„å»ºç»“æœ
- `mvn compile`ï¼šåªç¼–è¯‘ï¼Œä¸æµ‹è¯•
- `mvn test`ï¼šç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•
- `mvn package`ï¼šæ‰“åŒ…æˆjaræ–‡ä»¶
- `mvn clean package`ï¼šæ¸…ç†åé‡æ–°æ‰“åŒ…

### 3.4 å¤šç¯å¢ƒé…ç½®


**é…ç½®æ–‡ä»¶ç»“æ„**ï¼š
```
src/main/resources/
â”œâ”€â”€ application.yml              â† é»˜è®¤é…ç½®
â”œâ”€â”€ application-dev.yml          â† å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ application-test.yml         â† æµ‹è¯•ç¯å¢ƒé…ç½®
â””â”€â”€ application-prod.yml         â† ç”Ÿäº§ç¯å¢ƒé…ç½®
```

**application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰**ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mall_dev
    username: dev_user
    password: dev_password
  
logging:
  level:
    com.example.mall: DEBUG    # å¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
```

**application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/mall_prod
    username: ${DB_USERNAME}   # ç”Ÿäº§ç¯å¢ƒä»ç¯å¢ƒå˜é‡è¯»å–
    password: ${DB_PASSWORD}
  
logging:
  level:
    com.example.mall: WARN     # ç”Ÿäº§ç¯å¢ƒåªæ˜¾ç¤ºè­¦å‘Šæ—¥å¿—
```

**æ¿€æ´»ä¸åŒç¯å¢ƒ**ï¼š
```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
java -jar mall-system-1.0.0.jar --spring.profiles.active=dev

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
java -jar mall-system-1.0.0.jar --spring.profiles.active=prod
```

---

## 4. ğŸ§ª å•å…ƒæµ‹è¯•é›†æˆå®ç°


### 4.1 å•å…ƒæµ‹è¯•çš„é‡è¦æ€§


**ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•å°±åƒæ˜¯ç»™ä½ çš„ä»£ç åš"ä½“æ£€"ï¼Œæ¯å†™ä¸€ä¸ªåŠŸèƒ½å°±å†™ä¸€ä¸ªæµ‹è¯•æ¥éªŒè¯å®ƒæ˜¯å¦æ­£ç¡®å·¥ä½œã€‚

**ä¸ºä»€ä¹ˆè¦å†™å•å…ƒæµ‹è¯•**ï¼š
- **åŠæ—©å‘ç°é—®é¢˜**ï¼šå†™å®Œä»£ç ç«‹å³æµ‹è¯•ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ç”¨æˆ·åé¦ˆ
- **å›å½’æµ‹è¯•**ï¼šä¿®æ”¹ä»£ç åï¼Œè¿è¡Œæµ‹è¯•ç¡®ä¿æ²¡æœ‰ç ´ååŸæœ‰åŠŸèƒ½
- **æ–‡æ¡£ä½œç”¨**ï¼šæµ‹è¯•ç”¨ä¾‹å±•ç¤ºäº†ä»£ç çš„é¢„æœŸè¡Œä¸º
- **é‡æ„ä¿¡å¿ƒ**ï¼šæœ‰äº†æµ‹è¯•ä¿æŠ¤ï¼Œæ•¢äºä¼˜åŒ–ä»£ç ç»“æ„

### 4.2 Spring Bootæµ‹è¯•é…ç½®


**æµ‹è¯•ä¾èµ–ï¼ˆå·²åœ¨pom.xmlä¸­ï¼‰**ï¼š
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>
```

**æµ‹è¯•é…ç½®æ–‡ä»¶application-test.yml**ï¼š
```yaml
spring:
  datasource:
    # ä½¿ç”¨å†…å­˜æ•°æ®åº“H2è¿›è¡Œæµ‹è¯•
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  
  jpa:
    hibernate:
      ddl-auto: create-drop    # æµ‹è¯•å®Œè‡ªåŠ¨åˆ é™¤è¡¨
    show-sql: true

# æµ‹è¯•ç¯å¢ƒä½¿ç”¨éšæœºç«¯å£ï¼Œé¿å…å†²çª
server:
  port: 0
```

### 4.3 å•å…ƒæµ‹è¯•ç¤ºä¾‹


**ğŸ”¸ Serviceå±‚æµ‹è¯•**ï¼š
```java
@SpringBootTest
@ActiveProfiles("test")  // ä½¿ç”¨æµ‹è¯•ç¯å¢ƒé…ç½®
class ProductServiceTest {
    
    @Autowired
    private ProductService productService;
    
    @Test
    @DisplayName("æµ‹è¯•è·å–æ‰€æœ‰å•†å“åŠŸèƒ½")
    void testGetAllProducts() {
        // Given: å‡†å¤‡æµ‹è¯•æ•°æ®
        // è¿™é‡Œå¯ä»¥æ’å…¥ä¸€äº›æµ‹è¯•å•†å“æ•°æ®
        
        // When: æ‰§è¡Œè¦æµ‹è¯•çš„æ–¹æ³•
        List<Product> products = productService.getAllProducts();
        
        // Then: éªŒè¯ç»“æœ
        assertThat(products).isNotNull();
        assertThat(products.size()).isGreaterThanOrEqualTo(0);
    }
    
    @Test
    @DisplayName("æµ‹è¯•æ ¹æ®IDæŸ¥æ‰¾å•†å“")
    void testFindProductById() {
        // Given
        Long productId = 1L;
        
        // When
        Optional<Product> product = productService.findById(productId);
        
        // Then
        if (product.isPresent()) {
            assertThat(product.get().getId()).isEqualTo(productId);
        }
    }
}
```

**ğŸ”¸ Controllerå±‚æµ‹è¯•**ï¼š
```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@ActiveProfiles("test")
class ProductControllerTest {
    
    @Autowired
    private TestRestTemplate restTemplate;  // Springæä¾›çš„æµ‹è¯•å·¥å…·
    
    @Test
    @DisplayName("æµ‹è¯•è·å–å•†å“åˆ—è¡¨æ¥å£")
    void testGetProductList() {
        // When: è°ƒç”¨æ¥å£
        ResponseEntity<String> response = restTemplate.getForEntity(
            "/api/products/list", String.class);
        
        // Then: éªŒè¯å“åº”
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody()).isNotNull();
    }
    
    @Test
    @DisplayName("æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£")
    void testHealthCheck() {
        // When
        ResponseEntity<Map> response = restTemplate.getForEntity(
            "/api/products/health", Map.class);
        
        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().get("status")).isEqualTo("UP");
    }
}
```

### 4.4 æµ‹è¯•è¦†ç›–ç‡é…ç½®


**æ·»åŠ JaCoCoæ’ä»¶ï¼ˆä»£ç è¦†ç›–ç‡å·¥å…·ï¼‰**ï¼š
```xml
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.7</version>
    <executions>
        <execution>
            <goals>
                <goal>prepare-agent</goal>
            </goals>
        </execution>
        <execution>
            <id>report</id>
            <phase>test</phase>
            <goals>
                <goal>report</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

**è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š**ï¼š
```bash
mvn clean test jacoco:report
```

**æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š**ï¼šæŠ¥å‘Šç”Ÿæˆåœ¨`target/site/jacoco/index.html`ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€å¯ä»¥çœ‹åˆ°ï¼š
- å“ªäº›ä»£ç è¢«æµ‹è¯•è¦†ç›–äº†
- è¦†ç›–ç‡ç™¾åˆ†æ¯”
- å“ªäº›ä»£ç æ²¡æœ‰è¢«æµ‹è¯•åˆ°

---

## 5. ğŸ³ Dockeréƒ¨ç½²å®ç°


### 5.1 DockeråŸºç¡€æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯Docker**ï¼šDockerå°±åƒæ˜¯ä¸€ä¸ª"æ‰“åŒ…å·¥å…·"ï¼ŒæŠŠä½ çš„åº”ç”¨å’Œå®ƒéœ€è¦çš„æ‰€æœ‰ç¯å¢ƒï¼ˆJavaã€é…ç½®æ–‡ä»¶ã€ä¾èµ–åº“ï¼‰æ‰“åŒ…æˆä¸€ä¸ª"å®¹å™¨"ï¼Œè¿™ä¸ªå®¹å™¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒDockerçš„æœºå™¨ä¸Šè¿è¡Œã€‚

**Dockerçš„ä¼˜åŠ¿**ï¼š
```
ä¼ ç»Ÿéƒ¨ç½²ï¼š
å¼€å‘æœºå™¨ â†’ æ‰‹åŠ¨é…ç½®ç”Ÿäº§ç¯å¢ƒ â†’ å¯èƒ½å‡ºç°"æˆ‘è¿™é‡Œèƒ½è·‘"çš„é—®é¢˜

Dockeréƒ¨ç½²ï¼š
å¼€å‘æœºå™¨ â†’ æ‰“åŒ…æˆDockeré•œåƒ â†’ ä»»ä½•åœ°æ–¹éƒ½èƒ½å®Œå…¨ä¸€æ ·åœ°è¿è¡Œ
```

### 5.2 Dockerfileç¼–å†™


**é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºDockerfile**ï¼š
```dockerfile
# ä½¿ç”¨å®˜æ–¹OpenJDK 11ä½œä¸ºåŸºç¡€é•œåƒ
FROM openjdk:11-jre-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# åˆ›å»ºåº”ç”¨ç”¨æˆ·ï¼ˆå®‰å…¨è€ƒè™‘ï¼Œä¸ä½¿ç”¨rootç”¨æˆ·ï¼‰
RUN groupadd -r appuser && useradd -r -g appuser appuser

# å¤åˆ¶jaråŒ…åˆ°å®¹å™¨ä¸­
COPY target/mall-system-*.jar app.jar

# æ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€…
RUN chown appuser:appuser app.jar

# åˆ‡æ¢åˆ°åº”ç”¨ç”¨æˆ·
USER appuser

# æš´éœ²ç«¯å£ï¼ˆå‘Šè¯‰Dockeråº”ç”¨ç›‘å¬8080ç«¯å£ï¼‰
EXPOSE 8080

# è®¾ç½®JVMå‚æ•°ï¼ˆç”Ÿäº§ç¯å¢ƒä¼˜åŒ–ï¼‰
ENV JAVA_OPTS="-Xms512m -Xmx1024m -Djava.security.egd=file:/dev/./urandom"

# å¥åº·æ£€æŸ¥ï¼ˆDockerä¼šå®šæœŸæ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£å¸¸ï¼‰
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8080/api/products/health || exit 1

# å¯åŠ¨åº”ç”¨
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

**Dockerfileè§£é‡Š**ï¼š
- `FROM`ï¼šæŒ‡å®šåŸºç¡€é•œåƒï¼Œæˆ‘ä»¬ç”¨å®˜æ–¹çš„Java 11ç¯å¢ƒ
- `WORKDIR`ï¼šè®¾ç½®å®¹å™¨å†…çš„å·¥ä½œç›®å½•
- `COPY`ï¼šæŠŠç¼–è¯‘å¥½çš„jaråŒ…å¤åˆ¶åˆ°å®¹å™¨é‡Œ
- `EXPOSE`ï¼šå£°æ˜åº”ç”¨ä½¿ç”¨çš„ç«¯å£
- `HEALTHCHECK`ï¼šå®šæœŸæ£€æŸ¥åº”ç”¨æ˜¯å¦å¥åº·
- `ENTRYPOINT`ï¼šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤

### 5.3 Dockeræ„å»ºå’Œè¿è¡Œ


**ğŸ”¸ æ„å»ºDockeré•œåƒ**ï¼š
```bash
# é¦–å…ˆç”¨Mavenæ‰“åŒ…é¡¹ç›®
mvn clean package -DskipTests

# æ„å»ºDockeré•œåƒ
docker build -t mall-system:1.0.0 .

# æŸ¥çœ‹æ„å»ºçš„é•œåƒ
docker images | grep mall-system
```

**ğŸ”¸ è¿è¡ŒDockerå®¹å™¨**ï¼š
```bash
# åŸºæœ¬è¿è¡Œå‘½ä»¤
docker run -d \
  --name mall-app \
  -p 8080:8080 \
  mall-system:1.0.0

# å¸¦ç¯å¢ƒå˜é‡çš„è¿è¡Œï¼ˆæ¨èï¼‰
docker run -d \
  --name mall-app \
  -p 8080:8080 \
  -e SPRING_PROFILES_ACTIVE=prod \
  -e DB_USERNAME=prod_user \
  -e DB_PASSWORD=prod_password \
  mall-system:1.0.0
```

**å‘½ä»¤è§£é‡Š**ï¼š
- `-d`ï¼šåå°è¿è¡Œ
- `--name`ï¼šç»™å®¹å™¨èµ·ä¸ªåå­—
- `-p 8080:8080`ï¼šç«¯å£æ˜ å°„ï¼Œå®¿ä¸»æœº8080ç«¯å£æ˜ å°„åˆ°å®¹å™¨8080ç«¯å£
- `-e`ï¼šè®¾ç½®ç¯å¢ƒå˜é‡

### 5.4 Docker Composeé…ç½®


**docker-compose.ymlï¼ˆç®¡ç†å¤šä¸ªå®¹å™¨ï¼‰**ï¼š
```yaml
version: '3.8'

services:
  # åº”ç”¨æœåŠ¡
  mall-app:
    build: .                           # ä»å½“å‰ç›®å½•çš„Dockerfileæ„å»º
    ports:
      - "8080:8080"                   # ç«¯å£æ˜ å°„
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DB_USERNAME=mall_user
      - DB_PASSWORD=mall_password
    depends_on:
      - mysql                         # ä¾èµ–MySQLæœåŠ¡
    networks:
      - mall-network
    restart: unless-stopped           # è‡ªåŠ¨é‡å¯ç­–ç•¥
    
  # MySQLæ•°æ®åº“æœåŠ¡
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_DATABASE=mall_prod
      - MYSQL_USER=mall_user
      - MYSQL_PASSWORD=mall_password
      - MYSQL_ROOT_PASSWORD=root_password
    volumes:
      - mysql_data:/var/lib/mysql     # æ•°æ®æŒä¹…åŒ–
    networks:
      - mall-network
    restart: unless-stopped

# æ•°æ®å·å®šä¹‰
volumes:
  mysql_data:

# ç½‘ç»œå®šä¹‰
networks:
  mall-network:
    driver: bridge
```

**ä½¿ç”¨Docker Compose**ï¼š
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs mall-app

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down
```

---

## 6. ğŸ—„ï¸ æ•°æ®åº“è¿ç§»å¤„ç†


### 6.1 æ•°æ®åº“è¿ç§»æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿ç§»**ï¼šæ•°æ®åº“è¿ç§»å°±æ˜¯ç®¡ç†æ•°æ®åº“ç»“æ„å˜åŒ–çš„è¿‡ç¨‹ã€‚æ¯”å¦‚ä½ åœ¨å¼€å‘ä¸­éœ€è¦æ–°å¢ä¸€ä¸ªè¡¨ã€ä¿®æ”¹å­—æ®µï¼Œè¿™äº›å˜åŒ–éœ€è¦åœ¨æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒä¸­åŒæ­¥æ‰§è¡Œã€‚

**ä¸ºä»€ä¹ˆéœ€è¦è¿ç§»ç®¡ç†**ï¼š
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šåƒç®¡ç†ä»£ç ä¸€æ ·ç®¡ç†æ•°æ®åº“ç»“æ„
- **ç¯å¢ƒåŒæ­¥**ï¼šç¡®ä¿æ‰€æœ‰ç¯å¢ƒçš„æ•°æ®åº“ç»“æ„ä¸€è‡´
- **å›æ»šèƒ½åŠ›**ï¼šå‡ºé—®é¢˜æ—¶èƒ½å¤Ÿå›é€€åˆ°ä¹‹å‰çš„çŠ¶æ€
- **å›¢é˜Ÿåä½œ**ï¼šå¤šäººå¼€å‘æ—¶é¿å…æ•°æ®åº“å†²çª

### 6.2 Flywayæ•°æ®åº“è¿ç§»


**æ·»åŠ Flywayä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>org.flywaydb</groupId>
    <artifactId>flyway-core</artifactId>
</dependency>
<dependency>
    <groupId>org.flywaydb</groupId>
    <artifactId>flyway-mysql</artifactId>
</dependency>
```

**Flywayé…ç½®**ï¼š
```yaml
spring:
  flyway:
    enabled: true                              # å¯ç”¨Flyway
    baseline-on-migrate: true                  # åœ¨å·²æœ‰æ•°æ®åº“ä¸Šå¯ç”¨è¿ç§»
    locations: classpath:db/migration          # è¿ç§»è„šæœ¬ä½ç½®
    table: flyway_schema_history              # è¿ç§»è®°å½•è¡¨å
```

### 6.3 è¿ç§»è„šæœ¬ç¼–å†™


**è¿ç§»è„šæœ¬ç›®å½•ç»“æ„**ï¼š
```
src/main/resources/db/migration/
â”œâ”€â”€ V1__Create_user_table.sql              â† åˆ›å»ºç”¨æˆ·è¡¨
â”œâ”€â”€ V2__Create_product_table.sql           â† åˆ›å»ºå•†å“è¡¨
â”œâ”€â”€ V3__Add_user_email_column.sql          â† æ·»åŠ é‚®ç®±å­—æ®µ
â””â”€â”€ V4__Create_order_table.sql             â† åˆ›å»ºè®¢å•è¡¨
```

**V1__Create_user_table.sql**ï¼š
```sql
-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    password VARCHAR(255) NOT NULL COMMENT 'å¯†ç ',
    real_name VARCHAR(100) COMMENT 'çœŸå®å§“å',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_username ON users(username);
CREATE INDEX idx_phone ON users(phone);
```

**V2__Create_product_table.sql**ï¼š
```sql
-- åˆ›å»ºå•†å“è¡¨
CREATE TABLE products (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    description TEXT COMMENT 'å•†å“æè¿°',
    price DECIMAL(10,2) NOT NULL COMMENT 'ä»·æ ¼',
    stock INT DEFAULT 0 COMMENT 'åº“å­˜æ•°é‡',
    category_id BIGINT COMMENT 'åˆ†ç±»ID',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-ä¸Šæ¶ï¼Œ0-ä¸‹æ¶',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“è¡¨';

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_category_id ON products(category_id);
CREATE INDEX idx_status ON products(status);
```

**V3__Add_user_email_column.sql**ï¼š
```sql
-- ç»™ç”¨æˆ·è¡¨æ·»åŠ é‚®ç®±å­—æ®µ
ALTER TABLE users 
ADD COLUMN email VARCHAR(100) COMMENT 'é‚®ç®±' AFTER phone;

-- æ·»åŠ é‚®ç®±ç´¢å¼•
CREATE INDEX idx_email ON users(email);
```

### 6.4 è¿ç§»è„šæœ¬å‘½åè§„åˆ™


**Flywayå‘½åè§„åˆ™**ï¼š
```
V{ç‰ˆæœ¬å·}__{æè¿°}.sql

ç‰ˆæœ¬å·è§„åˆ™ï¼š
V1__åˆå§‹ç‰ˆæœ¬
V1.1__å°ç‰ˆæœ¬æ›´æ–°
V2__å¤§ç‰ˆæœ¬æ›´æ–°

æè¿°è§„åˆ™ï¼š
- ä½¿ç”¨è‹±æ–‡
- ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯
- ç®€æ´æ˜äº†åœ°æè¿°å˜æ›´å†…å®¹

ç¤ºä¾‹ï¼š
V1__Create_initial_tables.sql
V2__Add_user_avatar_column.sql
V3__Update_product_price_precision.sql
```

### 6.5 æ•°æ®åº“è¿ç§»åœ¨CI/CDä¸­çš„åº”ç”¨


**Jenkins Pipelineä¸­çš„è¿ç§»æ­¥éª¤**ï¼š
```groovy
stage('Database Migration') {
    steps {
        script {
            // ç­‰å¾…æ•°æ®åº“å°±ç»ª
            sh '''
                echo "ç­‰å¾…æ•°æ®åº“å¯åŠ¨..."
                timeout 60 bash -c 'until mysqladmin ping -h mysql -u root -p$MYSQL_ROOT_PASSWORD; do sleep 2; done'
                echo "æ•°æ®åº“è¿æ¥æˆåŠŸ"
            '''
            
            // æ‰§è¡Œæ•°æ®åº“è¿ç§»
            sh '''
                echo "æ‰§è¡Œæ•°æ®åº“è¿ç§»..."
                java -jar target/mall-system-*.jar \
                    --spring.profiles.active=prod \
                    --spring.flyway.migrate=true \
                    --spring.main.web-application-type=none
                echo "æ•°æ®åº“è¿ç§»å®Œæˆ"
            '''
        }
    }
}
```

**è¿ç§»éªŒè¯**ï¼š
```sql
-- æŸ¥çœ‹è¿ç§»å†å²
SELECT * FROM flyway_schema_history ORDER BY installed_on;

-- æ£€æŸ¥è¡¨ç»“æ„
DESCRIBE users;
DESCRIBE products;

-- éªŒè¯æ•°æ®
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM products;
```

---

## 7. ğŸ”„ å®Œæ•´Pipelineç¤ºä¾‹


### 7.1 å®Œæ•´Jenkinsfile


```groovy
pipeline {
    agent any
    
    // ç¯å¢ƒå˜é‡å®šä¹‰
    environment {
        DOCKER_IMAGE = 'mall-system'
        DOCKER_TAG = "${BUILD_NUMBER}"
        REGISTRY_URL = 'your-registry.com'
        DB_CREDENTIALS = credentials('mysql-credentials')  // Jenkinså‡­æ®
    }
    
    // æ„å»ºè§¦å‘å™¨
    triggers {
        // ä»£ç å˜æ›´æ—¶è§¦å‘ï¼ˆGitHub Webhookï¼‰
        githubPush()
        // å®šæ—¶æ„å»ºï¼ˆæ¯å¤©æ™šä¸Š2ç‚¹ï¼‰
        cron('0 2 * * *')
    }
    
    stages {
        // é˜¶æ®µ1ï¼šä»£ç æ£€å‡º
        stage('Checkout') {
            steps {
                echo 'å¼€å§‹æ£€å‡ºä»£ç ...'
                // Gitä»£ç æ£€å‡º
                checkout scm
                
                // æ˜¾ç¤ºä»£ç ä¿¡æ¯
                sh '''
                    echo "å½“å‰åˆ†æ”¯: $(git branch --show-current)"
                    echo "æœ€æ–°æäº¤: $(git log -1 --oneline)"
                    echo "æäº¤è€…: $(git log -1 --format='%an')"
                '''
            }
        }
        
        // é˜¶æ®µ2ï¼šä»£ç è´¨é‡æ£€æŸ¥
        stage('Code Quality') {
            parallel {
                // ä»£ç æ ¼å¼æ£€æŸ¥
                stage('Code Style') {
                    steps {
                        echo 'æ£€æŸ¥ä»£ç æ ¼å¼...'
                        sh 'mvn checkstyle:check'
                    }
                }
                
                // å®‰å…¨æ¼æ´æ‰«æ
                stage('Security Scan') {
                    steps {
                        echo 'æ‰«æå®‰å…¨æ¼æ´...'
                        sh 'mvn org.owasp:dependency-check-maven:check'
                    }
                }
            }
        }
        
        // é˜¶æ®µ3ï¼šç¼–è¯‘å’Œæµ‹è¯•
        stage('Build & Test') {
            steps {
                echo 'å¼€å§‹ç¼–è¯‘å’Œæµ‹è¯•...'
                
                // Mavenç¼–è¯‘
                sh '''
                    echo "æ¸…ç†ä¹‹å‰çš„æ„å»º..."
                    mvn clean
                    
                    echo "ç¼–è¯‘é¡¹ç›®..."
                    mvn compile
                    
                    echo "è¿è¡Œå•å…ƒæµ‹è¯•..."
                    mvn test
                '''
                
                // å‘å¸ƒæµ‹è¯•æŠ¥å‘Š
                publishTestResults testResultsPattern: 'target/surefire-reports/*.xml'
                
                // å‘å¸ƒä»£ç è¦†ç›–ç‡æŠ¥å‘Š
                publishHTML([
                    allowMissing: false,
                    alwaysLinkToLastBuild: true,
                    keepAll: true,
                    reportDir: 'target/site/jacoco',
                    reportFiles: 'index.html',
                    reportName: 'ä»£ç è¦†ç›–ç‡æŠ¥å‘Š'
                ])
            }
        }
        
        // é˜¶æ®µ4ï¼šæ‰“åŒ…
        stage('Package') {
            steps {
                echo 'æ‰“åŒ…åº”ç”¨...'
                sh '''
                    echo "åˆ›å»ºå¯æ‰§è¡ŒjaråŒ…..."
                    mvn package -DskipTests
                    
                    echo "éªŒè¯jaråŒ…..."
                    ls -la target/*.jar
                '''
                
                // ä¿å­˜æ„å»ºäº§ç‰©
                archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
            }
        }
        
        // é˜¶æ®µ5ï¼šDockeré•œåƒæ„å»º
        stage('Docker Build') {
            steps {
                echo 'æ„å»ºDockeré•œåƒ...'
                script {
                    // æ„å»ºé•œåƒ
                    def image = docker.build("${DOCKER_IMAGE}:${DOCKER_TAG}")
                    
                    // æ¨é€åˆ°é•œåƒä»“åº“
                    docker.withRegistry("https://${REGISTRY_URL}", 'docker-registry-credentials') {
                        image.push()
                        image.push('latest')  // åŒæ—¶æ¨é€latestæ ‡ç­¾
                    }
                    
                    echo "é•œåƒæ„å»ºå®Œæˆ: ${DOCKER_IMAGE}:${DOCKER_TAG}"
                }
            }
        }
        
        // é˜¶æ®µ6ï¼šéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
        stage('Deploy to Test') {
            steps {
                echo 'éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ...'
                script {
                    // ä½¿ç”¨Docker Composeéƒ¨ç½²
                    sh '''
                        echo "åœæ­¢æ—§çš„æµ‹è¯•ç¯å¢ƒ..."
                        docker-compose -f docker-compose.test.yml down || true
                        
                        echo "å¯åŠ¨æ–°çš„æµ‹è¯•ç¯å¢ƒ..."
                        export DOCKER_TAG=${DOCKER_TAG}
                        docker-compose -f docker-compose.test.yml up -d
                        
                        echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
                        sleep 30
                    '''
                }
            }
        }
        
        // é˜¶æ®µ7ï¼šé›†æˆæµ‹è¯•
        stage('Integration Test') {
            steps {
                echo 'æ‰§è¡Œé›†æˆæµ‹è¯•...'
                sh '''
                    echo "å¥åº·æ£€æŸ¥..."
                    curl -f http://localhost:8080/api/products/health || exit 1
                    
                    echo "APIåŠŸèƒ½æµ‹è¯•..."
                    # å¯ä»¥è¿è¡ŒPostmané›†åˆæˆ–å…¶ä»–APIæµ‹è¯•
                    # newman run api-tests.postman_collection.json
                    
                    echo "é›†æˆæµ‹è¯•å®Œæˆ"
                '''
            }
        }
        
        // é˜¶æ®µ8ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦æ‰‹åŠ¨ç¡®è®¤ï¼‰
        stage('Deploy to Production') {
            when {
                branch 'main'  // åªæœ‰mainåˆ†æ”¯æ‰èƒ½éƒ¨ç½²åˆ°ç”Ÿäº§
            }
            steps {
                script {
                    // æ‰‹åŠ¨ç¡®è®¤éƒ¨ç½²
                    def deploy = input message: 'æ˜¯å¦éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Ÿ',
                                     parameters: [choice(choices: ['Yes', 'No'], 
                                                       description: 'é€‰æ‹©æ˜¯å¦éƒ¨ç½²', 
                                                       name: 'DEPLOY')]
                    
                    if (deploy == 'Yes') {
                        echo 'éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ...'
                        
                        // æ•°æ®åº“è¿ç§»
                        sh '''
                            echo "æ‰§è¡Œæ•°æ®åº“è¿ç§»..."
                            # è¿™é‡Œæ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
                        '''
                        
                        // ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
                        sh '''
                            echo "æ›´æ–°ç”Ÿäº§ç¯å¢ƒ..."
                            export DOCKER_TAG=${DOCKER_TAG}
                            docker-compose -f docker-compose.prod.yml up -d
                            
                            echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
                            sleep 60
                            
                            echo "éªŒè¯ç”Ÿäº§ç¯å¢ƒ..."
                            curl -f http://your-production-url.com/api/products/health
                        '''
                        
                        echo 'ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®Œæˆï¼'
                    } else {
                        echo 'å–æ¶ˆéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ'
                    }
                }
            }
        }
    }
    
    // æ„å»ºåæ“ä½œ
    post {
        always {
            echo 'æ¸…ç†å·¥ä½œç©ºé—´...'
            // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            sh 'docker system prune -f'
        }
        
        success {
            echo 'æ„å»ºæˆåŠŸï¼'
            // å‘é€æˆåŠŸé€šçŸ¥
            emailext (
                subject: "âœ… æ„å»ºæˆåŠŸ: ${env.JOB_NAME} - ${env.BUILD_NUMBER}",
                body: """
                    æ„å»ºæˆåŠŸï¼
                    
                    é¡¹ç›®: ${env.JOB_NAME}
                    æ„å»ºå·: ${env.BUILD_NUMBER}
                    åˆ†æ”¯: ${env.BRANCH_NAME}
                    æäº¤: ${env.GIT_COMMIT}
                    
                    æŸ¥çœ‹è¯¦æƒ…: ${env.BUILD_URL}
                """,
                to: "${env.CHANGE_AUTHOR_EMAIL}"
            )
        }
        
        failure {
            echo 'æ„å»ºå¤±è´¥ï¼'
            // å‘é€å¤±è´¥é€šçŸ¥
            emailext (
                subject: "âŒ æ„å»ºå¤±è´¥: ${env.JOB_NAME} - ${env.BUILD_NUMBER}",
                body: """
                    æ„å»ºå¤±è´¥ï¼
                    
                    é¡¹ç›®: ${env.JOB_NAME}
                    æ„å»ºå·: ${env.BUILD_NUMBER}
                    åˆ†æ”¯: ${env.BRANCH_NAME}
                    é”™è¯¯æ—¥å¿—: ${env.BUILD_URL}console
                    
                    è¯·åŠæ—¶å¤„ç†ï¼
                """,
                to: "${env.CHANGE_AUTHOR_EMAIL}"
            )
        }
    }
}
```

### 7.2 å¤šç¯å¢ƒDocker Composeé…ç½®


**docker-compose.test.ymlï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰**ï¼š
```yaml
version: '3.8'

services:
  mall-app:
    image: mall-system:${DOCKER_TAG:-latest}
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=test
      - DB_USERNAME=test_user
      - DB_PASSWORD=test_password
    depends_on:
      - mysql-test
    networks:
      - test-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/products/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      
  mysql-test:
    image: mysql:8.0
    ports:
      - "3307:3306"  # é¿å…ä¸æœ¬åœ°MySQLå†²çª
    environment:
      - MYSQL_DATABASE=mall_test
      - MYSQL_USER=test_user
      - MYSQL_PASSWORD=test_password
      - MYSQL_ROOT_PASSWORD=test_root_password
    volumes:
      - test_mysql_data:/var/lib/mysql
    networks:
      - test-network

volumes:
  test_mysql_data:

networks:
  test-network:
    driver: bridge
```

**docker-compose.prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**ï¼š
```yaml
version: '3.8'

services:
  mall-app:
    image: mall-system:${DOCKER_TAG:-latest}
    ports:
      - "80:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
      - JAVA_OPTS=-Xms1g -Xmx2g
    depends_on:
      - mysql-prod
    networks:
      - prod-network
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 2g
        reservations:
          memory: 1g
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/products/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      
  mysql-prod:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_DATABASE=mall_prod
      - MYSQL_USER=${DB_USERNAME}
      - MYSQL_PASSWORD=${DB_PASSWORD}
      - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD}
    volumes:
      - prod_mysql_data:/var/lib/mysql
      - ./mysql/conf:/etc/mysql/conf.d  # ç”Ÿäº§ç¯å¢ƒMySQLé…ç½®
    networks:
      - prod-network
    restart: unless-stopped

volumes:
  prod_mysql_data:

networks:
  prod-network:
    driver: bridge
```

### 7.3 Pipelineæµç¨‹å›¾è§£


```
å¼€å‘è€…æäº¤ä»£ç 
         â†“
    [ä»£ç æ£€å‡º]
         â†“
   [ä»£ç è´¨é‡æ£€æŸ¥] â”€â”€ æ ¼å¼æ£€æŸ¥
         â”‚          â”‚
         â”‚          â””â”€â”€ å®‰å…¨æ‰«æ
         â†“
    [ç¼–è¯‘å’Œæµ‹è¯•] â”€â”€ å•å…ƒæµ‹è¯•
         â”‚          â”‚
         â”‚          â””â”€â”€ æµ‹è¯•æŠ¥å‘Š
         â†“
      [æ‰“åŒ…]
         â†“
   [Dockeræ„å»º] â”€â”€ æ„å»ºé•œåƒ
         â”‚          â”‚
         â”‚          â””â”€â”€ æ¨é€ä»“åº“
         â†“
   [éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ]
         â†“
    [é›†æˆæµ‹è¯•] â”€â”€ APIæµ‹è¯•
         â”‚        â”‚
         â”‚        â””â”€â”€ å¥åº·æ£€æŸ¥
         â†“
   [æ‰‹åŠ¨ç¡®è®¤] â”€â”€ æ˜¯å¦éƒ¨ç½²ç”Ÿäº§ï¼Ÿ
         â”‚
         â†“ (Yes)
   [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²] â”€â”€ æ•°æ®åº“è¿ç§»
         â”‚             â”‚
         â”‚             â””â”€â”€ æœåŠ¡æ›´æ–°
         â†“
    [éƒ¨ç½²å®Œæˆ] â”€â”€ é€šçŸ¥ç›¸å…³äººå‘˜
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Spring Bootï¼šJava Webåº”ç”¨çš„å¿«é€Ÿå¼€å‘æ¡†æ¶
ğŸ”¸ Mavenï¼šé¡¹ç›®æ„å»ºå’Œä¾èµ–ç®¡ç†å·¥å…·  
ğŸ”¸ å•å…ƒæµ‹è¯•ï¼šä»£ç è´¨é‡ä¿éšœçš„é‡è¦æ‰‹æ®µ
ğŸ”¸ Dockerï¼šåº”ç”¨å®¹å™¨åŒ–éƒ¨ç½²è§£å†³æ–¹æ¡ˆ
ğŸ”¸ æ•°æ®åº“è¿ç§»ï¼šæ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶ç®¡ç†
ğŸ”¸ Pipelineï¼šè‡ªåŠ¨åŒ–CI/CDæµæ°´çº¿
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦CI/CD**
```
é—®é¢˜è§£å†³ï¼š
- æ‰‹åŠ¨éƒ¨ç½²å®¹æ˜“å‡ºé”™ â†’ è‡ªåŠ¨åŒ–éƒ¨ç½²æ ‡å‡†åŒ–
- ç¯å¢ƒä¸ä¸€è‡´ â†’ Dockerå®¹å™¨åŒ–ç»Ÿä¸€ç¯å¢ƒ  
- æµ‹è¯•è¦†ç›–ä¸è¶³ â†’ è‡ªåŠ¨åŒ–æµ‹è¯•ä¿éšœè´¨é‡
- å‘å¸ƒå‘¨æœŸé•¿ â†’ æŒç»­äº¤ä»˜å¿«é€Ÿè¿­ä»£
```

**ğŸ”¹ Spring Bootçš„ä¼˜åŠ¿**
```
å¼€å‘æ•ˆç‡ï¼š
- è‡ªåŠ¨é…ç½®ï¼šå‡å°‘XMLé…ç½®
- å†…åµŒæœåŠ¡å™¨ï¼šæ— éœ€å•ç‹¬éƒ¨ç½²Tomcat
- èµ·æ­¥ä¾èµ–ï¼šç®€åŒ–ä¾èµ–ç®¡ç†
- ç›‘æ§å°±ç»ªï¼šæä¾›å¥åº·æ£€æŸ¥ç­‰åŠŸèƒ½
```

**ğŸ”¹ Dockerçš„ä»·å€¼**
```
éƒ¨ç½²ä¸€è‡´æ€§ï¼š
- å¼€å‘ç¯å¢ƒ = æµ‹è¯•ç¯å¢ƒ = ç”Ÿäº§ç¯å¢ƒ
- è§£å†³"æˆ‘è¿™é‡Œèƒ½è·‘"é—®é¢˜
- ç®€åŒ–ç¯å¢ƒé…ç½®å’Œç®¡ç†
- æ”¯æŒå¿«é€Ÿæ‰©å®¹å’Œå›æ»š
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é¡¹ç›®å®æˆ˜æ­¥éª¤**
1. **é¡¹ç›®æ­å»º**ï¼šä½¿ç”¨Spring Boot Initializrå¿«é€Ÿåˆ›å»ºé¡¹ç›®éª¨æ¶
2. **ä»£ç å¼€å‘**ï¼šæŒ‰ç…§MVCæ¨¡å¼ç»„ç»‡ä»£ç ç»“æ„
3. **æµ‹è¯•ç¼–å†™**ï¼šä¸ºæ¯ä¸ªåŠŸèƒ½ç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•
4. **DockeråŒ–**ï¼šç¼–å†™Dockerfileå®ç°å®¹å™¨åŒ–éƒ¨ç½²
5. **Pipelineé…ç½®**ï¼šåˆ›å»ºJenkinsfileå®ç°è‡ªåŠ¨åŒ–æµæ°´çº¿
6. **ç¯å¢ƒç®¡ç†**ï¼šé…ç½®å¤šç¯å¢ƒçš„å·®å¼‚åŒ–é…ç½®

**âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³**

| é—®é¢˜ç±»å‹ | å¸¸è§ç°è±¡ | è§£å†³æ–¹æ¡ˆ |
|---------|----------|----------|
| **ç¯å¢ƒé—®é¢˜** | æœ¬åœ°èƒ½è·‘ï¼ŒæœåŠ¡å™¨æŠ¥é”™ | ä½¿ç”¨Dockerç»Ÿä¸€ç¯å¢ƒï¼Œç¯å¢ƒå˜é‡ç®¡ç†é…ç½® |
| **ä¾èµ–å†²çª** | jaråŒ…ç‰ˆæœ¬ä¸å…¼å®¹ | ä½¿ç”¨Spring Boot BOMç®¡ç†ç‰ˆæœ¬ |
| **æµ‹è¯•å¤±è´¥** | å•å…ƒæµ‹è¯•åœ¨CIä¸­å¤±è´¥ | ä½¿ç”¨å†…å­˜æ•°æ®åº“H2ï¼Œéš”ç¦»æµ‹è¯•ç¯å¢ƒ |
| **éƒ¨ç½²ç¼“æ…¢** | éƒ¨ç½²æ—¶é—´è¿‡é•¿ | ä¼˜åŒ–Dockeré•œåƒå±‚ï¼Œä½¿ç”¨å¤šé˜¶æ®µæ„å»º |
| **æ•°æ®åº“é—®é¢˜** | æ•°æ®åº“ç»“æ„ä¸ä¸€è‡´ | ä½¿ç”¨Flywayç®¡ç†æ•°æ®åº“è¿ç§» |

### 8.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ”§ å¼€å‘è§„èŒƒ**
- **ä»£ç è´¨é‡**ï¼šä¿æŒ80%ä»¥ä¸Šçš„æµ‹è¯•è¦†ç›–ç‡
- **æäº¤è§„èŒƒ**ï¼šä½¿ç”¨è¯­ä¹‰åŒ–çš„commit message
- **åˆ†æ”¯ç­–ç•¥**ï¼šé‡‡ç”¨GitFlowæˆ–GitHub Flowå·¥ä½œæµ
- **é…ç½®ç®¡ç†**ï¼šæ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡

**ğŸš€ éƒ¨ç½²ç­–ç•¥**
- **è“ç»¿éƒ¨ç½²**ï¼šç»´æŠ¤ä¸¤å¥—ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿é›¶åœæœºå‘å¸ƒ
- **ç°åº¦å‘å¸ƒ**ï¼šæ–°åŠŸèƒ½å…ˆåœ¨å°éƒ¨åˆ†ç”¨æˆ·ä¸­éªŒè¯
- **ç›‘æ§å‘Šè­¦**ï¼šå®Œå–„çš„åº”ç”¨ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦æœºåˆ¶
- **å›æ»šæœºåˆ¶**ï¼šå¿«é€Ÿå›æ»šåˆ°ç¨³å®šç‰ˆæœ¬çš„èƒ½åŠ›

**ğŸ“Š æ€§èƒ½ä¼˜åŒ–**
- **æ„å»ºä¼˜åŒ–**ï¼šä½¿ç”¨Mavenå¤šæ¨¡å—ï¼ŒæŒ‰éœ€æ„å»º
- **é•œåƒä¼˜åŒ–**ï¼šä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Œå‡å°é•œåƒä½“ç§¯
- **ç¼“å­˜ç­–ç•¥**ï¼šå……åˆ†åˆ©ç”¨Dockerå±‚ç¼“å­˜å’ŒMavenç¼“å­˜
- **å¹¶è¡Œæ‰§è¡Œ**ï¼šPipelineä¸­çš„å¹¶è¡Œé˜¶æ®µæé«˜æ•ˆç‡

**æ ¸å¿ƒè®°å¿†**ï¼š
- Spring Bootè®©Java Webå¼€å‘æ›´ç®€å•é«˜æ•ˆ
- Mavenç®¡ç†é¡¹ç›®ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–å…³ç³»
- å•å…ƒæµ‹è¯•æ˜¯ä»£ç è´¨é‡çš„é‡è¦ä¿éšœ
- Dockerè§£å†³äº†"åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘"çš„é—®é¢˜
- CI/CD Pipelineè‡ªåŠ¨åŒ–äº†è½¯ä»¶äº¤ä»˜æµç¨‹
- æ•°æ®åº“è¿ç§»ç®¡ç†ç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§