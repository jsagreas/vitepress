---
title: 2ã€å£°æ˜å¼Pipelineè¯­æ³•
---
## ğŸ“š ç›®å½•

1. [Pipelineä»£ç å—ç»“æ„](#1-Pipelineä»£ç å—ç»“æ„)
2. [agentæ‰§è¡Œç¯å¢ƒé…ç½®](#2-agentæ‰§è¡Œç¯å¢ƒé…ç½®)
3. [stagesé˜¶æ®µå®šä¹‰](#3-stagesé˜¶æ®µå®šä¹‰)
4. [stepsæ­¥éª¤ç¼–å†™](#4-stepsæ­¥éª¤ç¼–å†™)
5. [environmentç¯å¢ƒå˜é‡](#5-environmentç¯å¢ƒå˜é‡)
6. [postæ„å»ºåå¤„ç†](#6-postæ„å»ºåå¤„ç†)
7. [å®Œæ•´ç¤ºä¾‹ä¸æœ€ä½³å®è·µ](#7-å®Œæ•´ç¤ºä¾‹ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ Pipelineä»£ç å—ç»“æ„


### 1.1 ä»€ä¹ˆæ˜¯å£°æ˜å¼Pipeline


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
å£°æ˜å¼Pipelineå°±åƒæ˜¯ç»™Jenkinså†™çš„"å‰§æœ¬"ï¼Œå‘Šè¯‰å®ƒæŒ‰ç…§ä»€ä¹ˆæ­¥éª¤æ¥å®Œæˆè½¯ä»¶çš„æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹åŠ¨ç‚¹å‡»Jenkinsç•Œé¢æ“ä½œ
å£°æ˜å¼Pipelineï¼šå†™ä»£ç æ¥æè¿°æ•´ä¸ªæµç¨‹

å°±åƒåšèœï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šæ¯æ¬¡éƒ½è¦æ‰‹åŠ¨æ“ä½œæ¯ä¸ªæ­¥éª¤
Pipelineï¼šå†™å¥½èœè°±ï¼ŒæŒ‰èœè°±è‡ªåŠ¨æ‰§è¡Œ
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦ç”¨å£°æ˜å¼Pipeline**
```
âœ… ä»£ç åŒ–ç®¡ç†ï¼šæµæ°´çº¿é…ç½®å˜æˆä»£ç ï¼Œå¯ä»¥ç‰ˆæœ¬æ§åˆ¶
âœ… å¯é‡å¤æ‰§è¡Œï¼šåŒæ ·çš„ä»£ç ï¼Œç»“æœä¸€è‡´
âœ… æ˜“äºç»´æŠ¤ï¼šä¿®æ”¹é…ç½®å°±åƒä¿®æ”¹ä»£ç ä¸€æ ·ç®€å•
âœ… å›¢é˜Ÿåä½œï¼šå›¢é˜Ÿæˆå‘˜éƒ½èƒ½çœ‹æ‡‚å’Œä¿®æ”¹
âœ… è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜ï¼šå‡å°‘äººå·¥æ“ä½œé”™è¯¯
```

### 1.2 åŸºæœ¬ä»£ç å—ç»“æ„


**ğŸ›ï¸ Pipelineçš„åŸºæœ¬æ¡†æ¶**
```groovy
pipeline {
    // åœ¨å“ªé‡Œæ‰§è¡Œï¼ˆå¿…éœ€ï¼‰
    agent any
    
    // æ‰§è¡Œé˜¶æ®µï¼ˆå¿…éœ€ï¼‰
    stages {
        stage('é˜¶æ®µåç§°') {
            steps {
                // å…·ä½“æ‰§è¡Œæ­¥éª¤
            }
        }
    }
}
```

**ğŸ“‹ ç»“æ„è§£æ**
```
pipeline {}: æœ€å¤–å±‚å®¹å™¨ï¼Œå‘Šè¯‰Jenkinsè¿™æ˜¯ä¸€ä¸ªPipeline
â”œâ”€â”€ agent: æŒ‡å®šåœ¨å“ªå°æœºå™¨ä¸Šæ‰§è¡Œ
â”œâ”€â”€ stages: åŒ…å«æ‰€æœ‰æ‰§è¡Œé˜¶æ®µ
â”‚   â””â”€â”€ stage: å•ä¸ªæ‰§è¡Œé˜¶æ®µ
â”‚       â””â”€â”€ steps: å…·ä½“æ‰§è¡Œçš„å‘½ä»¤
â””â”€â”€ post: æ‰§è¡Œå®Œæˆåçš„å¤„ç†ï¼ˆå¯é€‰ï¼‰
```

### 1.3 å£°æ˜å¼vsè„šæœ¬å¼Pipelineå¯¹æ¯”


| ç‰¹æ€§ | **å£°æ˜å¼Pipeline** | **è„šæœ¬å¼Pipeline** |
|------|------------------|------------------|
| ğŸ“ **è¯­æ³•** | `ç»“æ„åŒ–ï¼Œç±»ä¼¼é…ç½®æ–‡ä»¶` | `æ›´åƒç¼–ç¨‹è¯­è¨€` |
| ğŸ¯ **å­¦ä¹ éš¾åº¦** | `ç®€å•ï¼Œæ–°æ‰‹å‹å¥½` | `å¤æ‚ï¼Œéœ€è¦ç¼–ç¨‹åŸºç¡€` |
| ğŸ”§ **çµæ´»æ€§** | `ç»“æ„å›ºå®šï¼Œä½†å¤Ÿç”¨` | `éå¸¸çµæ´»` |
| âš¡ **æ¨èç¨‹åº¦** | `å®˜æ–¹æ¨èï¼Œä¸»æµé€‰æ‹©` | `é«˜çº§ç”¨æˆ·ä½¿ç”¨` |

---

## 2. ğŸ–¥ï¸ agentæ‰§è¡Œç¯å¢ƒé…ç½®


### 2.1 ä»€ä¹ˆæ˜¯agent


**ğŸ”¸ é€šä¿—ç†è§£**
agentå°±æ˜¯å‘Šè¯‰Jenkins"è¿™ä¸ªä»»åŠ¡è¦åœ¨å“ªå°ç”µè„‘ä¸Šæ‰§è¡Œ"ã€‚

```
ç°å®ç±»æ¯”ï¼š
ä½ è¦åšä¸€é“èœï¼Œéœ€è¦é€‰æ‹©åœ¨å“ªä¸ªå¨æˆ¿åšï¼š
- è‡ªå·±å®¶å¨æˆ¿ï¼ˆJenkinsä¸»èŠ‚ç‚¹ï¼‰
- æœ‹å‹å®¶å¨æˆ¿ï¼ˆä»èŠ‚ç‚¹ï¼‰
- ä»»æ„å¯ç”¨å¨æˆ¿ï¼ˆanyï¼‰
- ç‰¹å®šè®¾å¤‡å¨æˆ¿ï¼ˆæœ‰çƒ¤ç®±çš„å¨æˆ¿ = ç‰¹å®šæ ‡ç­¾çš„èŠ‚ç‚¹ï¼‰
```

### 2.2 å¸¸ç”¨agenté…ç½®æ–¹å¼


**ğŸ¯ æœ€å¸¸ç”¨çš„é…ç½®**

```groovy
// 1. ä»»æ„å¯ç”¨èŠ‚ç‚¹æ‰§è¡Œ
pipeline {
    agent any
    // ...
}

// 2. ä¸æŒ‡å®šèŠ‚ç‚¹ï¼ˆæ¯ä¸ªstageè‡ªå·±æŒ‡å®šï¼‰
pipeline {
    agent none
    stages {
        stage('æ„å»º') {
            agent any
            steps {
                // è¿™ä¸ªé˜¶æ®µçš„æ­¥éª¤
            }
        }
    }
}

// 3. æŒ‡å®šç‰¹å®šèŠ‚ç‚¹æ ‡ç­¾
pipeline {
    agent {
        label 'linux-node'
    }
    // ...
}
```

**ğŸ“Š agenté…ç½®é€‰é¡¹å¯¹æ¯”**

| é…ç½®æ–¹å¼ | **ä½¿ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **æ³¨æ„äº‹é¡¹** |
|---------|------------|---------|-------------|
| `agent any` | `å°å›¢é˜Ÿï¼ŒèŠ‚ç‚¹é…ç½®ç›¸ä¼¼` | `ç®€å•ï¼Œä¸ç”¨è€ƒè™‘èŠ‚ç‚¹é€‰æ‹©` | `å¯èƒ½åœ¨ä¸åˆé€‚çš„èŠ‚ç‚¹æ‰§è¡Œ` |
| `agent none` | `ä¸åŒé˜¶æ®µéœ€è¦ä¸åŒç¯å¢ƒ` | `çµæ´»ï¼Œç²¾ç¡®æ§åˆ¶` | `æ¯ä¸ªstageéƒ½è¦æŒ‡å®šagent` |
| `agent { label 'xxx' }` | `éœ€è¦ç‰¹å®šç¯å¢ƒçš„ä»»åŠ¡` | `ç²¾ç¡®æ§åˆ¶æ‰§è¡Œç¯å¢ƒ` | `éœ€è¦æå‰é…ç½®èŠ‚ç‚¹æ ‡ç­¾` |

### 2.3 Dockerç¯å¢ƒagent


**ğŸ³ ä½¿ç”¨Dockerä½œä¸ºæ‰§è¡Œç¯å¢ƒ**
```groovy
pipeline {
    agent {
        docker {
            image 'node:16'  // ä½¿ç”¨Node.js 16ç¯å¢ƒ
            args '-v /var/run/docker.sock:/var/run/docker.sock'
        }
    }
    stages {
        stage('æ„å»º') {
            steps {
                sh 'npm install'
                sh 'npm run build'
            }
        }
    }
}
```

**ğŸ’¡ Docker agentçš„å¥½å¤„**
```
âœ… ç¯å¢ƒéš”ç¦»ï¼šæ¯æ¬¡æ„å»ºéƒ½æ˜¯å…¨æ–°ç¯å¢ƒ
âœ… ç‰ˆæœ¬å›ºå®šï¼šç¡®ä¿ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„å·¥å…·
âœ… è½»é‡çº§ï¼šç›¸æ¯”è™šæ‹Ÿæœºæ›´å¿«å¯åŠ¨
âœ… å¯é‡å¤ï¼šæœ¬åœ°å’ŒCIç¯å¢ƒå®Œå…¨ä¸€è‡´
```

---

## 3. ğŸ“‹ stagesé˜¶æ®µå®šä¹‰


### 3.1 stagesçš„ä½œç”¨å’Œæ„ä¹‰


**ğŸ”¸ ä»€ä¹ˆæ˜¯stages**
stageså°±æ˜¯æŠŠæ•´ä¸ªCI/CDæµç¨‹åˆ†æˆå‡ ä¸ªå¤§æ­¥éª¤ï¼Œå°±åƒåšé¡¹ç›®åˆ†æˆå‡ ä¸ªé˜¶æ®µä¸€æ ·ã€‚

```
è½¯ä»¶å¼€å‘æµç¨‹ â†’ Pipeline stages
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¼–å†™ä»£ç    â”‚ â†’  â”‚   æ‹‰å–ä»£ç     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœ¬åœ°æµ‹è¯•   â”‚ â†’  â”‚   æ„å»ºé¡¹ç›®    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä»£ç æ£€æŸ¥   â”‚ â†’  â”‚   è¿è¡Œæµ‹è¯•    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   éƒ¨ç½²æµ‹è¯•   â”‚ â†’  â”‚   éƒ¨ç½²åº”ç”¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 stageçš„åŸºæœ¬è¯­æ³•


**ğŸ—ï¸ å•ä¸ªstageçš„ç»“æ„**
```groovy
stage('é˜¶æ®µåç§°') {
    steps {
        // è¿™ä¸ªé˜¶æ®µè¦åšçš„äº‹æƒ…
        echo 'æ­£åœ¨æ‰§è¡ŒæŸä¸ªæ­¥éª¤'
        sh 'npm install'
    }
}
```

**ğŸ“ stageå‘½åå»ºè®®**
```groovy
stages {
    stage('ğŸ“¥ æ‹‰å–ä»£ç ') {
        steps {
            checkout scm
        }
    }
    
    stage('ğŸ”¨ æ„å»ºé¡¹ç›®') {
        steps {
            sh 'npm install'
            sh 'npm run build'
        }
    }
    
    stage('ğŸ§ª è¿è¡Œæµ‹è¯•') {
        steps {
            sh 'npm test'
        }
    }
    
    stage('ğŸš€ éƒ¨ç½²åº”ç”¨') {
        steps {
            sh 'docker build -t myapp .'
            sh 'docker run -d myapp'
        }
    }
}
```

### 3.3 æ¡ä»¶æ‰§è¡Œå’Œå¹¶è¡Œå¤„ç†


**ğŸ”€ æ¡ä»¶æ‰§è¡Œstage**
```groovy
stage('éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ') {
    when {
        branch 'main'  // åªæœ‰mainåˆ†æ”¯æ‰éƒ¨ç½²
    }
    steps {
        echo 'éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ'
    }
}
```

**âš¡ å¹¶è¡Œæ‰§è¡Œstages**
```groovy
stages {
    stage('å¹¶è¡Œæµ‹è¯•') {
        parallel {
            stage('å•å…ƒæµ‹è¯•') {
                steps {
                    sh 'npm run test:unit'
                }
            }
            stage('é›†æˆæµ‹è¯•') {
                steps {
                    sh 'npm run test:integration'
                }
            }
        }
    }
}
```

---

## 4. âš™ï¸ stepsæ­¥éª¤ç¼–å†™


### 4.1 ä»€ä¹ˆæ˜¯steps


**ğŸ”¸ é€šä¿—ç†è§£**
stepså°±æ˜¯å…·ä½“è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå°±åƒèœè°±ä¸­çš„æ¯ä¸€ä¸ªå…·ä½“æ“ä½œæ­¥éª¤ã€‚

```
åšè›‹ç‚’é¥­çš„stepsï¼š
1. æ‰“è›‹ â†’ echo 'å‡†å¤‡é¸¡è›‹'
2. çƒ­é”… â†’ sh 'heat pan'
3. å€’æ²¹ â†’ sh 'add oil'
4. ç‚’è›‹ â†’ sh 'cook egg'
5. åŠ é¥­ â†’ sh 'add rice'
```

### 4.2 å¸¸ç”¨stepså‘½ä»¤


**ğŸ“ åŸºç¡€å‘½ä»¤ç±»å‹**

```groovy
steps {
    // 1. è¾“å‡ºä¿¡æ¯
    echo 'Hello Jenkins!'
    
    // 2. æ‰§è¡ŒShellå‘½ä»¤ï¼ˆLinux/Macï¼‰
    sh 'ls -la'
    sh 'npm install'
    
    // 3. æ‰§è¡Œæ‰¹å¤„ç†å‘½ä»¤ï¼ˆWindowsï¼‰
    bat 'dir'
    bat 'npm install'
    
    // 4. æ£€å‡ºä»£ç 
    checkout scm
    
    // 5. å‘é€é€šçŸ¥
    emailext (
        subject: "æ„å»ºå®Œæˆ",
        body: "æ„å»ºå·²å®Œæˆ",
        to: "dev@company.com"
    )
}
```

**ğŸ¯ å®é™…é¡¹ç›®å¸¸ç”¨steps**
```groovy
stage('æ„å»ºé˜¶æ®µ') {
    steps {
        // æ¸…ç†æ—§æ–‡ä»¶
        sh 'rm -rf dist/'
        
        // å®‰è£…ä¾èµ–
        sh 'npm ci'  // æ¯”npm installæ›´é€‚åˆCIç¯å¢ƒ
        
        // è¿è¡Œæ„å»º
        sh 'npm run build'
        
        // æ£€æŸ¥æ„å»ºç»“æœ
        sh 'test -d dist && echo "æ„å»ºæˆåŠŸ" || exit 1'
    }
}
```

### 4.3 é”™è¯¯å¤„ç†å’Œé‡è¯•


**ğŸ”„ å¤±è´¥é‡è¯•æœºåˆ¶**
```groovy
steps {
    retry(3) {  // å¤±è´¥æ—¶é‡è¯•3æ¬¡
        sh 'npm test'
    }
}
```

**â±ï¸ è¶…æ—¶æ§åˆ¶**
```groovy
steps {
    timeout(time: 5, unit: 'MINUTES') {  // 5åˆ†é’Ÿè¶…æ—¶
        sh 'npm run slow-test'
    }
}
```

---

## 5. ğŸŒ environmentç¯å¢ƒå˜é‡


### 5.1 ç¯å¢ƒå˜é‡çš„ä½œç”¨


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦ç¯å¢ƒå˜é‡**
ç¯å¢ƒå˜é‡å°±åƒæ˜¯ç»™Pipelineè®¾ç½®çš„"å…¨å±€é…ç½®"ï¼Œè®©ä¸åŒçš„æ­¥éª¤å¯ä»¥å…±äº«ä¿¡æ¯ã€‚

```
ç°å®ç±»æ¯”ï¼š
å®¶åº­WiFiå¯†ç  â†’ å…¨å±€ç¯å¢ƒå˜é‡ï¼ˆæ‰€æœ‰äººéƒ½èƒ½ç”¨ï¼‰
ä¸ªäººæ‰‹æœºå·ç  â†’ å±€éƒ¨ç¯å¢ƒå˜é‡ï¼ˆåªåœ¨ç‰¹å®šåœºåˆç”¨ï¼‰
```

### 5.2 å…¨å±€ç¯å¢ƒå˜é‡


**ğŸŒ åœ¨pipelineçº§åˆ«è®¾ç½®**
```groovy
pipeline {
    agent any
    
    environment {
        NODE_VERSION = '16'
        APP_NAME = 'my-awesome-app'
        BUILD_NUMBER = "${env.BUILD_NUMBER}"
        GIT_COMMIT = "${env.GIT_COMMIT}"
    }
    
    stages {
        stage('æ„å»º') {
            steps {
                echo "æ„å»ºåº”ç”¨: ${APP_NAME}"
                echo "Nodeç‰ˆæœ¬: ${NODE_VERSION}"
                sh 'echo $APP_NAME'  // Shellä¸­ä½¿ç”¨
            }
        }
    }
}
```

### 5.3 å±€éƒ¨ç¯å¢ƒå˜é‡


**ğŸ  åœ¨stageçº§åˆ«è®¾ç½®**
```groovy
stages {
    stage('æµ‹è¯•ç¯å¢ƒéƒ¨ç½²') {
        environment {
            DEPLOY_ENV = 'test'
            DATABASE_URL = 'test-db.example.com'
        }
        steps {
            echo "éƒ¨ç½²åˆ°: ${DEPLOY_ENV}"
            sh 'echo "æ•°æ®åº“: $DATABASE_URL"'
        }
    }
    
    stage('ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²') {
        environment {
            DEPLOY_ENV = 'production'
            DATABASE_URL = 'prod-db.example.com'
        }
        steps {
            echo "éƒ¨ç½²åˆ°: ${DEPLOY_ENV}"
        }
    }
}
```

### 5.4 å‡­æ®ç®¡ç†


**ğŸ” å®‰å…¨åœ°ä½¿ç”¨å¯†ç å’Œå¯†é’¥**
```groovy
environment {
    // ä»Jenkinså‡­æ®ä¸­è·å–
    DOCKER_PASSWORD = credentials('docker-hub-password')
    API_KEY = credentials('api-key')
    
    // ç»„åˆä½¿ç”¨
    DOCKER_IMAGE = "${APP_NAME}:${BUILD_NUMBER}"
}

stages {
    stage('æ¨é€é•œåƒ') {
        steps {
            sh '''
                echo $DOCKER_PASSWORD | docker login -u myuser --password-stdin
                docker push $DOCKER_IMAGE
            '''
        }
    }
}
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
âœ… å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯å¿…é¡»ç”¨credentials()å‡½æ•°
âœ… ä¸è¦åœ¨ä»£ç ä¸­ç›´æ¥å†™å¯†ç 
âœ… ä½¿ç”¨Jenkinså‡­æ®ç®¡ç†åŠŸèƒ½
âŒ ä¸è¦ç”¨echoè¾“å‡ºæ•æ„Ÿä¿¡æ¯
âŒ ä¸è¦æŠŠå¯†ç æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
```

---

## 6. ğŸ”„ postæ„å»ºåå¤„ç†


### 6.1 postçš„ä½œç”¨å’Œæ—¶æœº


**ğŸ”¸ ä»€ä¹ˆæ˜¯post**
postå°±æ˜¯"å–„åå·¥ä½œ"ï¼Œæ— è®ºPipelineæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦åšçš„æ”¶å°¾å·¥ä½œã€‚

```
ç°å®ç±»æ¯”ï¼š
åšå®Œèœåçš„å–„åå·¥ä½œï¼š
- ä¸ç®¡èœåšå¾—å¥½ä¸å¥½ï¼Œéƒ½è¦æ´—é”…æ´—ç¢—
- å¦‚æœèœç³Šäº†ï¼Œè¦å¼€çª—é€šé£
- å¦‚æœèœåšæˆåŠŸäº†ï¼Œè¦æ‹ç…§åˆ†äº«

Pipeline postï¼š
- ä¸ç®¡æ„å»ºæˆåŠŸå¤±è´¥ï¼Œéƒ½è¦æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- å¦‚æœæ„å»ºå¤±è´¥ï¼Œè¦å‘é€å‘Šè­¦é‚®ä»¶
- å¦‚æœæ„å»ºæˆåŠŸï¼Œè¦å‘é€æˆåŠŸé€šçŸ¥
```

### 6.2 postè§¦å‘æ¡ä»¶


**ğŸ“‹ ä¸åŒçš„postæ¡ä»¶**
```groovy
post {
    always {
        // æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œ
        echo 'æ„å»ºå®Œæˆï¼Œå¼€å§‹æ¸…ç†'
        deleteDir()  // æ¸…ç†å·¥ä½œç©ºé—´
    }
    
    success {
        // åªæœ‰æˆåŠŸæ—¶æ‰§è¡Œ
        echo 'ğŸ‰ æ„å»ºæˆåŠŸï¼'
        emailext (
            subject: "âœ… æ„å»ºæˆåŠŸ - ${env.JOB_NAME}",
            body: "æ„å»º #${env.BUILD_NUMBER} æˆåŠŸå®Œæˆ",
            to: "team@company.com"
        )
    }
    
    failure {
        // åªæœ‰å¤±è´¥æ—¶æ‰§è¡Œ
        echo 'âŒ æ„å»ºå¤±è´¥ï¼'
        emailext (
            subject: "ğŸš¨ æ„å»ºå¤±è´¥ - ${env.JOB_NAME}",
            body: "æ„å»º #${env.BUILD_NUMBER} å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—",
            to: "devops@company.com"
        )
    }
    
    unstable {
        // æ„å»ºä¸ç¨³å®šæ—¶æ‰§è¡Œï¼ˆæ¯”å¦‚æµ‹è¯•éƒ¨åˆ†å¤±è´¥ï¼‰
        echo 'âš ï¸ æ„å»ºä¸ç¨³å®š'
    }
}
```

### 6.3 å®ç”¨çš„postæ“ä½œ


**ğŸ§¹ æ¸…ç†å’Œå½’æ¡£**
```groovy
post {
    always {
        // å½’æ¡£æ„å»ºäº§ç‰©
        archiveArtifacts artifacts: 'dist/**', allowEmptyArchive: true
        
        // å‘å¸ƒæµ‹è¯•æŠ¥å‘Š
        publishTestResults testResultsPattern: 'test-results.xml'
        
        // æ¸…ç†Dockeré•œåƒ
        sh 'docker system prune -f'
        
        // æ¸…ç†npmç¼“å­˜
        sh 'npm cache clean --force'
    }
    
    success {
        // æ ‡è®°Gitæäº¤çŠ¶æ€
        step([
            $class: 'GitHubCommitStatusSetter',
            contextSource: 'Jenkins',
            statusResultSource: 'success'
        ])
    }
    
    failure {
        // ä¿ç•™å¤±è´¥æ—¶çš„è°ƒè¯•ä¿¡æ¯
        archiveArtifacts artifacts: 'logs/**', allowEmptyArchive: true
        
        // å‘é€Slacké€šçŸ¥
        slackSend channel: '#devops',
                  color: 'danger',
                  message: "âŒ æ„å»ºå¤±è´¥: ${env.JOB_NAME} #${env.BUILD_NUMBER}"
    }
}
```

---

## 7. ğŸ¯ å®Œæ•´ç¤ºä¾‹ä¸æœ€ä½³å®è·µ


### 7.1 å®Œæ•´çš„Node.jsé¡¹ç›®Pipeline


```groovy
pipeline {
    agent any
    
    environment {
        NODE_VERSION = '16'
        APP_NAME = 'my-web-app'
        DOCKER_IMAGE = "${APP_NAME}:${BUILD_NUMBER}"
        REGISTRY_URL = 'registry.company.com'
    }
    
    stages {
        stage('ğŸ“¥ æ‹‰å–ä»£ç ') {
            steps {
                echo 'å¼€å§‹æ‹‰å–ä»£ç ...'
                checkout scm
                sh 'git log --oneline -5'  // æ˜¾ç¤ºæœ€è¿‘5æ¬¡æäº¤
            }
        }
        
        stage('ğŸ” ä»£ç æ£€æŸ¥') {
            parallel {
                stage('ESLintæ£€æŸ¥') {
                    steps {
                        sh 'npm run lint'
                    }
                }
                stage('å®‰å…¨æ‰«æ') {
                    steps {
                        sh 'npm audit --audit-level high'
                    }
                }
            }
        }
        
        stage('ğŸ”¨ æ„å»ºé¡¹ç›®') {
            steps {
                echo 'å¼€å§‹æ„å»ºé¡¹ç›®...'
                sh 'npm ci'  // ä½¿ç”¨ciè€Œä¸æ˜¯installï¼Œæ›´é€‚åˆCIç¯å¢ƒ
                sh 'npm run build'
                
                // æ£€æŸ¥æ„å»ºäº§ç‰©
                sh 'ls -la dist/'
            }
        }
        
        stage('ğŸ§ª è¿è¡Œæµ‹è¯•') {
            steps {
                echo 'å¼€å§‹è¿è¡Œæµ‹è¯•...'
                sh 'npm run test:coverage'
            }
            post {
                always {
                    // å‘å¸ƒæµ‹è¯•æŠ¥å‘Šå’Œè¦†ç›–ç‡æŠ¥å‘Š
                    publishTestResults testResultsPattern: 'test-results.xml'
                    publishCoverage adapters: [
                        istanbulCoberturaAdapter('coverage/cobertura-coverage.xml')
                    ]
                }
            }
        }
        
        stage('ğŸ³ æ„å»ºé•œåƒ') {
            when {
                anyOf {
                    branch 'main'
                    branch 'develop'
                }
            }
            steps {
                echo 'å¼€å§‹æ„å»ºDockeré•œåƒ...'
                sh "docker build -t ${DOCKER_IMAGE} ."
                sh "docker tag ${DOCKER_IMAGE} ${REGISTRY_URL}/${DOCKER_IMAGE}"
            }
        }
        
        stage('ğŸš€ éƒ¨ç½²åº”ç”¨') {
            when {
                branch 'main'
            }
            environment {
                DEPLOY_ENV = 'production'
            }
            steps {
                echo 'å¼€å§‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ...'
                sh "docker push ${REGISTRY_URL}/${DOCKER_IMAGE}"
                
                // éƒ¨ç½²åˆ°Kubernetes
                sh """
                    kubectl set image deployment/${APP_NAME} \
                    ${APP_NAME}=${REGISTRY_URL}/${DOCKER_IMAGE}
                """
                
                // ç­‰å¾…éƒ¨ç½²å®Œæˆ
                sh "kubectl rollout status deployment/${APP_NAME}"
            }
        }
    }
    
    post {
        always {
            echo 'å¼€å§‹æ¸…ç†å·¥ä½œ...'
            
            // æ¸…ç†æœ¬åœ°Dockeré•œåƒ
            sh "docker rmi ${DOCKER_IMAGE} || true"
            sh "docker rmi ${REGISTRY_URL}/${DOCKER_IMAGE} || true"
            
            // æ¸…ç†å·¥ä½œç©ºé—´ä¸­çš„node_modules
            sh 'rm -rf node_modules'
            
            // å½’æ¡£é‡è¦æ–‡ä»¶
            archiveArtifacts artifacts: 'dist/**', allowEmptyArchive: true
        }
        
        success {
            echo 'ğŸ‰ Pipelineæ‰§è¡ŒæˆåŠŸï¼'
            
            // å‘é€æˆåŠŸé€šçŸ¥
            emailext (
                subject: "âœ… éƒ¨ç½²æˆåŠŸ - ${APP_NAME} #${BUILD_NUMBER}",
                body: """
                <h2>éƒ¨ç½²æˆåŠŸï¼</h2>
                <p><strong>é¡¹ç›®:</strong> ${APP_NAME}</p>
                <p><strong>æ„å»ºå·:</strong> ${BUILD_NUMBER}</p>
                <p><strong>Gitæäº¤:</strong> ${env.GIT_COMMIT}</p>
                <p><strong>æ„å»ºæ—¶é—´:</strong> ${currentBuild.duration/1000}ç§’</p>
                """,
                mimeType: 'text/html',
                to: 'team@company.com'
            )
        }
        
        failure {
            echo 'âŒ Pipelineæ‰§è¡Œå¤±è´¥ï¼'
            
            // å‘é€å¤±è´¥å‘Šè­¦
            emailext (
                subject: "ğŸš¨ éƒ¨ç½²å¤±è´¥ - ${APP_NAME} #${BUILD_NUMBER}",
                body: """
                <h2>éƒ¨ç½²å¤±è´¥ï¼</h2>
                <p><strong>é¡¹ç›®:</strong> ${APP_NAME}</p>
                <p><strong>æ„å»ºå·:</strong> ${BUILD_NUMBER}</p>
                <p><strong>å¤±è´¥é˜¶æ®µ:</strong> ${env.STAGE_NAME}</p>
                <p>è¯·æ£€æŸ¥æ„å»ºæ—¥å¿—: ${env.BUILD_URL}</p>
                """,
                mimeType: 'text/html',
                to: 'devops@company.com'
            )
        }
        
        unstable {
            echo 'âš ï¸ Pipelineä¸ç¨³å®šï¼'
            // å‘é€è­¦å‘Šé€šçŸ¥
        }
    }
}
```

### 7.2 Pipelineç¼–å†™æœ€ä½³å®è·µ


**ğŸ“‹ ä»£ç ç»„ç»‡å»ºè®®**
```
1. ğŸ“ æ–‡ä»¶ç»„ç»‡
   Jenkinsfile â†’ æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•
   pipeline/ â†’ å¤æ‚é¡¹ç›®å¯ä»¥æ‹†åˆ†å¤šä¸ªæ–‡ä»¶
   
2. ğŸ·ï¸ å‘½åè§„èŒƒ
   âœ… stageåç§°è¦æ¸…æ™°ï¼š'æ„å»ºå‰ç«¯', 'éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ'
   âœ… ç¯å¢ƒå˜é‡ç”¨å¤§å†™ï¼šNODE_VERSION, APP_NAME
   âœ… æ·»åŠ emojiè®©æ—¥å¿—æ›´æ˜“è¯»ï¼š'ğŸ”¨ å¼€å§‹æ„å»º'
   
3. ğŸ”’ å®‰å…¨è€ƒè™‘
   âœ… æ•æ„Ÿä¿¡æ¯ç”¨credentials()
   âœ… ä¸åœ¨æ—¥å¿—ä¸­è¾“å‡ºå¯†ç 
   âœ… é™åˆ¶Pipelineæƒé™
```

**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```groovy
// 1. ä½¿ç”¨å¹¶è¡Œæ‰§è¡Œ
parallel {
    stage('å•å…ƒæµ‹è¯•') { /* ... */ }
    stage('é›†æˆæµ‹è¯•') { /* ... */ }
    stage('å®‰å…¨æ‰«æ') { /* ... */ }
}

// 2. åˆç†è®¾ç½®è¶…æ—¶
timeout(time: 10, unit: 'MINUTES') {
    sh 'npm test'
}

// 3. è·³è¿‡ä¸å¿…è¦çš„æ­¥éª¤
when {
    not { changeRequest() }  // ä¸æ˜¯PRæ—¶æ‰æ‰§è¡Œ
    branch 'main'           // åªåœ¨mainåˆ†æ”¯æ‰§è¡Œ
}

// 4. ç¼“å­˜ä¾èµ–
sh 'npm ci --cache .npm'  // ä½¿ç”¨æœ¬åœ°ç¼“å­˜
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Pipelineç»“æ„ï¼špipeline â†’ agent â†’ stages â†’ stage â†’ steps
ğŸ”¸ æ‰§è¡Œç¯å¢ƒï¼šagentå†³å®šåœ¨å“ªé‡Œæ‰§è¡Œï¼Œæ”¯æŒany/none/label/docker
ğŸ”¸ é˜¶æ®µåˆ’åˆ†ï¼šstagesæŠŠæµç¨‹åˆ†æˆé€»è¾‘æ­¥éª¤ï¼Œä¾¿äºç®¡ç†å’Œè°ƒè¯•
ğŸ”¸ å…·ä½“æ“ä½œï¼šstepsåŒ…å«å®é™…æ‰§è¡Œçš„å‘½ä»¤å’Œæ“ä½œ
ğŸ”¸ ç¯å¢ƒé…ç½®ï¼šenvironmentè®¾ç½®å…¨å±€å’Œå±€éƒ¨å˜é‡
ğŸ”¸ å–„åå¤„ç†ï¼špostå¤„ç†æˆåŠŸã€å¤±è´¥ã€æ¸…ç†ç­‰åç»­å·¥ä½œ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å£°æ˜å¼Pipelineçš„ä¼˜åŠ¿**
```
ä»£ç åŒ–ç®¡ç†ï¼š
- Pipelineå³ä»£ç ï¼Œå¯ä»¥ç‰ˆæœ¬æ§åˆ¶
- ä¿®æ”¹æµç¨‹å°±åƒä¿®æ”¹ä»£ç ä¸€æ ·
- å›¢é˜Ÿåä½œæ›´å®¹æ˜“

å¯è§†åŒ–æ‰§è¡Œï¼š
- Jenkinsç•Œé¢æ¸…æ™°æ˜¾ç¤ºå„ä¸ªé˜¶æ®µ
- æ¯ä¸ªstageçš„æ‰§è¡ŒçŠ¶æ€ä¸€ç›®äº†ç„¶
- å¤±è´¥æ—¶å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜

é‡å¤æ€§å’Œä¸€è‡´æ€§ï¼š
- åŒæ ·çš„ä»£ç ï¼Œæ¯æ¬¡æ‰§è¡Œç»“æœä¸€è‡´
- é¿å…æ‰‹åŠ¨æ“ä½œçš„é”™è¯¯
- æ–°é¡¹ç›®å¯ä»¥å¤ç”¨æˆç†Ÿçš„Pipeline
```

**ğŸ”¹ å®é™…åº”ç”¨ä¸­çš„æ³¨æ„äº‹é¡¹**
```
æ€§èƒ½è€ƒè™‘ï¼š
- å¹¶è¡Œæ‰§è¡Œäº’ä¸ä¾èµ–çš„stage
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
- ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤ä¸‹è½½

é”™è¯¯å¤„ç†ï¼š
- å…³é”®æ­¥éª¤è¦æœ‰é‡è¯•æœºåˆ¶
- å¤±è´¥æ—¶ä¿ç•™è°ƒè¯•ä¿¡æ¯
- åŠæ—¶é€šçŸ¥ç›¸å…³äººå‘˜

å®‰å…¨æ€§ï¼š
- æ•æ„Ÿä¿¡æ¯å¿…é¡»ç”¨credentials
- é™åˆ¶Pipelineçš„æ‰§è¡Œæƒé™
- å®šæœŸæ›´æ–°ä¾èµ–ç‰ˆæœ¬
```

### 8.3 å­¦ä¹ å»ºè®®å’Œå®è·µæ–¹å‘


**ğŸ¯ å¾ªåºæ¸è¿›çš„å­¦ä¹ è·¯å¾„**
```
ç¬¬ä¸€æ­¥ï¼šåŸºç¡€Pipeline
- æŒæ¡åŸºæœ¬è¯­æ³•ç»“æ„
- å®Œæˆç®€å•çš„æ„å»ºæµç¨‹
- ç†è§£agentã€stagesã€stepsçš„ä½œç”¨

ç¬¬äºŒæ­¥ï¼šä¸°å¯ŒåŠŸèƒ½
- æ·»åŠ æµ‹è¯•å’Œéƒ¨ç½²é˜¶æ®µ
- ä½¿ç”¨environmenté…ç½®ç¯å¢ƒå˜é‡
- ç¼–å†™postå¤„ç†é€»è¾‘

ç¬¬ä¸‰æ­¥ï¼šä¼˜åŒ–å’Œå®Œå–„
- å®ç°å¹¶è¡Œæ‰§è¡Œ
- æ·»åŠ æ¡ä»¶åˆ¤æ–­
- é›†æˆé€šçŸ¥å’ŒæŠ¥å‘ŠåŠŸèƒ½

ç¬¬å››æ­¥ï¼šé«˜çº§ç‰¹æ€§
- ä½¿ç”¨å…±äº«åº“å¤ç”¨ä»£ç 
- å®ç°å¤šåˆ†æ”¯Pipeline
- é›†æˆæ›´å¤šå·¥å…·å’Œå¹³å°
```

**ğŸ”§ å®è·µå»ºè®®**
```
ä»ç®€å•å¼€å§‹ï¼š
- å…ˆå†™ä¸€ä¸ªæœ€åŸºæœ¬çš„Pipeline
- é€æ­¥æ·»åŠ æ–°åŠŸèƒ½
- æ¯æ¬¡åªæ”¹ä¸€ä¸ªåœ°æ–¹ï¼Œé¿å…å‡ºé”™éš¾ä»¥è°ƒè¯•

å¤šçœ‹å¤šç»ƒï¼š
- å‚è€ƒå®˜æ–¹æ–‡æ¡£å’Œç¤ºä¾‹
- å­¦ä¹ ä¼˜ç§€å¼€æºé¡¹ç›®çš„Pipeline
- åœ¨æµ‹è¯•ç¯å¢ƒå¤šå°è¯•

å›¢é˜Ÿåä½œï¼š
- å»ºç«‹å›¢é˜Ÿçš„Pipelineç¼–å†™è§„èŒƒ
- å…±äº«å¸¸ç”¨çš„Pipelineæ¨¡æ¿
- å®šæœŸreviewå’Œä¼˜åŒ–Pipelineä»£ç 
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- å£°æ˜å¼Pipelineå°±æ˜¯ç”¨ä»£ç æè¿°CI/CDæµç¨‹
- åŸºæœ¬ç»“æ„ï¼šagentæŒ‡å®šæ‰§è¡Œç¯å¢ƒï¼ŒstagesåŒ…å«æ‰§è¡Œé˜¶æ®µï¼Œstepsæ˜¯å…·ä½“æ“ä½œ
- environmentç®¡ç†ç¯å¢ƒå˜é‡ï¼Œpostå¤„ç†å–„åå·¥ä½œ
- é‡ç‚¹æ˜¯ç†è§£æ¯ä¸ªç»„ä»¶çš„ä½œç”¨ï¼Œç„¶åç»„åˆä½¿ç”¨è§£å†³å®é™…é—®é¢˜