---
title: 5ã€å…±äº«åº“ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [å…±äº«åº“æ¦‚å¿µä¸ä½œç”¨](#1-å…±äº«åº“æ¦‚å¿µä¸ä½œç”¨)
2. [åº“æ–‡ä»¶ç»„ç»‡ç»“æ„](#2-åº“æ–‡ä»¶ç»„ç»‡ç»“æ„)
3. [å…¨å±€å˜é‡å®šä¹‰](#3-å…¨å±€å˜é‡å®šä¹‰)
4. [è‡ªå®šä¹‰æ­¥éª¤å¼€å‘](#4-è‡ªå®šä¹‰æ­¥éª¤å¼€å‘)
5. [åº“ç‰ˆæœ¬ç®¡ç†](#5-åº“ç‰ˆæœ¬ç®¡ç†)
6. [åº“çš„ä½¿ç”¨ä¸è°ƒç”¨](#6-åº“çš„ä½¿ç”¨ä¸è°ƒç”¨)
7. [æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜](#7-æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ å…±äº«åº“æ¦‚å¿µä¸ä½œç”¨


### 1.1 ä»€ä¹ˆæ˜¯Jenkinså…±äº«åº“


**é€šä¿—ç†è§£**ï¼š
æƒ³è±¡ä½ åœ¨å†™ä»£ç æ—¶ï¼Œç»å¸¸éœ€è¦é‡å¤å†™ç›¸åŒçš„åŠŸèƒ½ï¼Œæ¯”å¦‚å‘é€é‚®ä»¶ã€éƒ¨ç½²åº”ç”¨ç­‰ã€‚å…±äº«åº“å°±åƒæ˜¯ä¸€ä¸ª"å·¥å…·ç®±"ï¼ŒæŠŠè¿™äº›å¸¸ç”¨çš„åŠŸèƒ½å°è£…èµ·æ¥ï¼Œè®©æ‰€æœ‰çš„Jenkinsé¡¹ç›®éƒ½å¯ä»¥é‡å¤ä½¿ç”¨ã€‚

```
æ²¡æœ‰å…±äº«åº“çš„æƒ…å†µï¼š
é¡¹ç›®Açš„Pipeline â”€â”€> é‡å¤å†™éƒ¨ç½²ä»£ç 
é¡¹ç›®Bçš„Pipeline â”€â”€> é‡å¤å†™éƒ¨ç½²ä»£ç   
é¡¹ç›®Cçš„Pipeline â”€â”€> é‡å¤å†™éƒ¨ç½²ä»£ç 

æœ‰äº†å…±äº«åº“ï¼š
é¡¹ç›®Aã€Bã€C â”€â”€> è°ƒç”¨å…±äº«åº“ä¸­çš„éƒ¨ç½²å‡½æ•°
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”„ **ä»£ç å¤ç”¨**ï¼šä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„ä½¿ç”¨
- ğŸ“ **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€å›¢é˜Ÿçš„CI/CDæµç¨‹
- ğŸ›¡ï¸ **å®‰å…¨æ€§**ï¼šé›†ä¸­ç®¡ç†æ•æ„Ÿæ“ä½œ
- ğŸš€ **æ•ˆç‡æå‡**ï¼šå‡å°‘é‡å¤å·¥ä½œ

### 1.2 å…±äº«åº“è§£å†³äº†ä»€ä¹ˆé—®é¢˜


**âŒ ä¼ ç»Ÿæ–¹å¼çš„ç—›ç‚¹**ï¼š
```
ç—›ç‚¹1ï¼šä»£ç é‡å¤
æ¯ä¸ªé¡¹ç›®éƒ½è¦å†™ç›¸åŒçš„æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²è„šæœ¬

ç—›ç‚¹2ï¼šç»´æŠ¤å›°éš¾  
ä¿®æ”¹ä¸€ä¸ªæµç¨‹ï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰é¡¹ç›®çš„Pipeline

ç—›ç‚¹3ï¼šæ ‡å‡†ä¸ç»Ÿä¸€
ä¸åŒå›¢é˜Ÿå†™çš„Pipelineé£æ ¼å·®å¼‚å¾ˆå¤§

ç—›ç‚¹4ï¼šæƒé™æ§åˆ¶éš¾
æ•æ„Ÿæ“ä½œåˆ†æ•£åœ¨å„ä¸ªé¡¹ç›®ä¸­ï¼Œéš¾ä»¥ç®¡æ§
```

**âœ… å…±äº«åº“çš„è§£å†³æ–¹æ¡ˆ**ï¼š
```
è§£å†³æ–¹æ¡ˆ1ï¼šç»Ÿä¸€å°è£…
å¸¸ç”¨åŠŸèƒ½å°è£…æˆå‡½æ•°ï¼Œé¡¹ç›®ç›´æ¥è°ƒç”¨

è§£å†³æ–¹æ¡ˆ2ï¼šé›†ä¸­ç»´æŠ¤
åªéœ€è¦åœ¨å…±äº«åº“ä¸­ä¿®æ”¹ï¼Œæ‰€æœ‰é¡¹ç›®è‡ªåŠ¨ç”Ÿæ•ˆ

è§£å†³æ–¹æ¡ˆ3ï¼šå¼ºåˆ¶æ ‡å‡†
é€šè¿‡å…±äº«åº“ç»Ÿä¸€CI/CDæµç¨‹å’Œè§„èŒƒ

è§£å†³æ–¹æ¡ˆ4ï¼šæƒé™é›†ä¸­
æ•æ„Ÿæ“ä½œåœ¨å…±äº«åº“ä¸­æ§åˆ¶ï¼Œæ™®é€šå¼€å‘è€…æ— æ³•ç›´æ¥è®¿é—®
```

### 1.3 å…±äº«åº“çš„ç±»å‹


| ç±»å‹ | **è¯´æ˜** | **ä½¿ç”¨åœºæ™¯** | **ç®¡ç†æ–¹å¼** |
|------|----------|-------------|-------------|
| ğŸŒ **å…¨å±€å…±äº«åº“** | `æ‰€æœ‰Jenkinsé¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨` | `å…¬å¸çº§åˆ«çš„é€šç”¨åŠŸèƒ½` | `Jenkinsç®¡ç†å‘˜é…ç½®` |
| ğŸ“ **æ–‡ä»¶å¤¹çº§å…±äº«åº“** | `ç‰¹å®šæ–‡ä»¶å¤¹ä¸‹çš„é¡¹ç›®å¯ç”¨` | `éƒ¨é—¨çº§åˆ«çš„ä¸“ç”¨åŠŸèƒ½` | `æ–‡ä»¶å¤¹ç®¡ç†å‘˜é…ç½®` |
| ğŸ¯ **é¡¹ç›®çº§å…±äº«åº“** | `å•ä¸ªé¡¹ç›®ä¸“ç”¨` | `é¡¹ç›®ç‰¹å®šçš„è‡ªå®šä¹‰åŠŸèƒ½` | `é¡¹ç›®å¼€å‘è€…é…ç½®` |

---

## 2. ğŸ“‚ åº“æ–‡ä»¶ç»„ç»‡ç»“æ„


### 2.1 æ ‡å‡†ç›®å½•ç»“æ„


**Jenkinså…±äº«åº“**æœ‰ç€ä¸¥æ ¼çš„ç›®å½•ç»“æ„ï¼Œå°±åƒæ˜¯ä¸€ä¸ª"æœ‰è§„çŸ©çš„å›¾ä¹¦é¦†"ï¼Œæ¯ç§æ–‡ä»¶éƒ½æœ‰è‡ªå·±çš„ä½ç½®ï¼š

```
my-jenkins-library/          â† å…±äº«åº“æ ¹ç›®å½•
â”œâ”€â”€ vars/                    â† å…¨å±€å˜é‡ç›®å½•ï¼ˆæœ€å¸¸ç”¨ï¼‰
â”‚   â”œâ”€â”€ deployApp.groovy     â† éƒ¨ç½²åº”ç”¨å‡½æ•°
â”‚   â”œâ”€â”€ sendEmail.groovy     â† å‘é€é‚®ä»¶å‡½æ•°
â”‚   â””â”€â”€ buildDocker.groovy   â† Dockeræ„å»ºå‡½æ•°
â”œâ”€â”€ src/                     â† æºä»£ç ç›®å½•ï¼ˆå¤æ‚é€»è¾‘ï¼‰
â”‚   â””â”€â”€ com/
â”‚       â””â”€â”€ company/
â”‚           â””â”€â”€ jenkins/
â”‚               â””â”€â”€ Utils.groovy
â”œâ”€â”€ resources/               â† èµ„æºæ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ deploy.sh        â† éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ email.html       â† é‚®ä»¶æ¨¡æ¿
â””â”€â”€ README.md               â† è¯´æ˜æ–‡æ¡£
```

### 2.2 å„ç›®å½•çš„è¯¦ç»†è¯´æ˜


**ğŸ“ varsç›®å½• - å…¨å±€å˜é‡**
```
ä½œç”¨ï¼šå­˜æ”¾å¯ä»¥ç›´æ¥åœ¨Pipelineä¸­è°ƒç”¨çš„å‡½æ•°
ç‰¹ç‚¹ï¼šæ–‡ä»¶åå°±æ˜¯å‡½æ•°åï¼Œè‡ªåŠ¨æš´éœ²ç»™æ‰€æœ‰Pipeline
å‘½åè§„åˆ™ï¼šé©¼å³°å‘½åæ³•ï¼Œå¦‚ deployApp.groovy

ä½¿ç”¨æ–¹å¼ï¼š
Pipelineä¸­ç›´æ¥è°ƒç”¨ï¼šdeployApp()
```

**ğŸ“ srcç›®å½• - æºä»£ç **  
```
ä½œç”¨ï¼šå­˜æ”¾å¤æ‚çš„Groovyç±»å’Œå·¥å…·å‡½æ•°
ç‰¹ç‚¹ï¼šéµå¾ªJavaåŒ…ç»“æ„ï¼Œéœ€è¦importæ‰èƒ½ä½¿ç”¨
é€‚åˆï¼šå¤æ‚ä¸šåŠ¡é€»è¾‘ã€å·¥å…·ç±»ã€æ•°æ®å¤„ç†

ä½¿ç”¨æ–¹å¼ï¼š
@Library('my-lib') import com.company.jenkins.Utils
```

**ğŸ“ resourcesç›®å½• - èµ„æºæ–‡ä»¶**
```
ä½œç”¨ï¼šå­˜æ”¾è„šæœ¬ã€æ¨¡æ¿ã€é…ç½®æ–‡ä»¶ç­‰é™æ€èµ„æº
ç‰¹ç‚¹ï¼šå¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡libraryResourceè¯»å–
å¸¸è§æ–‡ä»¶ï¼šshellè„šæœ¬ã€é…ç½®æ¨¡æ¿ã€SQLæ–‡ä»¶

ä½¿ç”¨æ–¹å¼ï¼š
def script = libraryResource 'scripts/deploy.sh'
```

### 2.3 ç›®å½•ç»“æ„æœ€ä½³å®è·µ


**ğŸ¯ æŒ‰åŠŸèƒ½åˆ†ç±»**ï¼š
```
vars/
â”œâ”€â”€ deploy/                  â† éƒ¨ç½²ç›¸å…³
â”‚   â”œâ”€â”€ deployK8s.groovy
â”‚   â””â”€â”€ deployDocker.groovy
â”œâ”€â”€ build/                   â† æ„å»ºç›¸å…³  
â”‚   â”œâ”€â”€ buildMaven.groovy
â”‚   â””â”€â”€ buildNode.groovy
â”œâ”€â”€ notify/                  â† é€šçŸ¥ç›¸å…³
â”‚   â”œâ”€â”€ sendSlack.groovy
â”‚   â””â”€â”€ sendEmail.groovy
â””â”€â”€ util/                    â† å·¥å…·å‡½æ•°
    â”œâ”€â”€ gitHelper.groovy
    â””â”€â”€ timeHelper.groovy
```

**ğŸ“‹ å‘½åè§„èŒƒ**ï¼š
- **åŠ¨è¯å¼€å¤´**ï¼š`deployApp`, `buildImage`, `sendNotification`
- **é©¼å³°å‘½å**ï¼š`deployToKubernetes` è€Œä¸æ˜¯ `deploy_to_kubernetes`
- **åŠŸèƒ½æ˜ç¡®**ï¼š`scanCodeQuality` è€Œä¸æ˜¯ `scan`

---

## 3. ğŸŒ å…¨å±€å˜é‡å®šä¹‰


### 3.1 å…¨å±€å˜é‡çš„æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šå…¨å±€å˜é‡å°±æ˜¯æ”¾åœ¨`vars`ç›®å½•ä¸‹çš„`.groovy`æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¼šè‡ªåŠ¨å˜æˆå¯ä»¥åœ¨Pipelineä¸­ç›´æ¥è°ƒç”¨çš„å‡½æ•°ã€‚

**å·¥ä½œåŸç†**ï¼š
```
æ–‡ä»¶è·¯å¾„ï¼švars/deployApp.groovy
å‡½æ•°åç§°ï¼šdeployApp
è°ƒç”¨æ–¹å¼ï¼šPipelineä¸­ç›´æ¥å†™ deployApp()

å°±åƒé­”æ³•ä¸€æ ·ï¼ŒJenkinsä¼šè‡ªåŠ¨æŠŠæ–‡ä»¶åå˜æˆå‡½æ•°åï¼
```

### 3.2 å…¨å±€å˜é‡çš„åŸºæœ¬å†™æ³•


**ğŸ’¡ æœ€ç®€å•çš„å…¨å±€å˜é‡**ï¼š

`vars/sayHello.groovy`ï¼š
```groovy
// æœ€ç®€å•çš„å‡½æ•°ï¼Œç›´æ¥è¿”å›å­—ç¬¦ä¸²
def call() {
    echo "Hello from shared library!"
}
```

Pipelineä¸­ä½¿ç”¨ï¼š
```groovy
pipeline {
    agent any
    stages {
        stage('Test') {
            steps {
                sayHello()  // ç›´æ¥è°ƒç”¨
            }
        }
    }
}
```

**ğŸ”§ å¸¦å‚æ•°çš„å…¨å±€å˜é‡**ï¼š

`vars/deployApp.groovy`ï¼š
```groovy
def call(appName, environment) {
    echo "æ­£åœ¨éƒ¨ç½²åº”ç”¨ï¼š${appName} åˆ°ç¯å¢ƒï¼š${environment}"
    
    // éƒ¨ç½²é€»è¾‘
    sh """
        echo "å¼€å§‹éƒ¨ç½² ${appName}"
        echo "ç›®æ ‡ç¯å¢ƒï¼š${environment}"
        echo "éƒ¨ç½²å®Œæˆï¼"
    """
}
```

Pipelineä¸­ä½¿ç”¨ï¼š
```groovy
stages {
    stage('Deploy') {
        steps {
            deployApp('my-web-app', 'production')
        }
    }
}
```

### 3.3 å¤æ‚å…¨å±€å˜é‡ç¤ºä¾‹


**ğŸ“¨ å‘é€é‚®ä»¶é€šçŸ¥**ï¼š

`vars/sendEmail.groovy`ï¼š
```groovy
def call(Map config) {
    // è®¾ç½®é»˜è®¤å€¼
    def recipients = config.to ?: 'dev-team@company.com'
    def subject = config.subject ?: 'æ„å»ºé€šçŸ¥'
    def body = config.body ?: 'æ„å»ºå·²å®Œæˆ'
    
    echo "å‘é€é‚®ä»¶é€šçŸ¥..."
    echo "æ”¶ä»¶äººï¼š${recipients}"
    echo "ä¸»é¢˜ï¼š${subject}"
    
    // å®é™…çš„é‚®ä»¶å‘é€é€»è¾‘
    emailext (
        to: recipients,
        subject: subject,
        body: body
    )
}
```

ä½¿ç”¨æ–¹å¼ï¼š
```groovy
// ç®€å•è°ƒç”¨
sendEmail()

// å¸¦å‚æ•°è°ƒç”¨
sendEmail([
    to: 'admin@company.com',
    subject: 'éƒ¨ç½²æˆåŠŸ',
    body: 'åº”ç”¨å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ'
])
```

### 3.4 å…¨å±€å˜é‡çš„é«˜çº§ç‰¹æ€§


**ğŸ”„ æ”¯æŒé—­åŒ…è°ƒç”¨**ï¼š

`vars/withDocker.groovy`ï¼š
```groovy
def call(String imageName, Closure body) {
    echo "ä½¿ç”¨Dockeré•œåƒï¼š${imageName}"
    
    docker.image(imageName).inside {
        body()
    }
}
```

ä½¿ç”¨æ–¹å¼ï¼š
```groovy
withDocker('node:14') {
    sh 'npm install'
    sh 'npm test'
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- ğŸ“ å‡½æ•°åå¿…é¡»æ˜¯`call`
- ğŸ·ï¸ æ–‡ä»¶åå†³å®šäº†åœ¨Pipelineä¸­çš„è°ƒç”¨å
- ğŸ”§ æ”¯æŒå¤šç§å‚æ•°ç±»å‹ï¼šå­—ç¬¦ä¸²ã€Mapã€é—­åŒ…ç­‰
- ğŸ“‹ å»ºè®®æ·»åŠ æ–‡æ¡£æ³¨é‡Šè¯´æ˜ç”¨æ³•

---

## 4. ğŸ› ï¸ è‡ªå®šä¹‰æ­¥éª¤å¼€å‘


### 4.1 è‡ªå®šä¹‰æ­¥éª¤çš„è®¾è®¡æ€è·¯


**è®¾è®¡åŸåˆ™**ï¼š
1. **å•ä¸€èŒè´£** - æ¯ä¸ªæ­¥éª¤åªåšä¸€ä»¶äº‹
2. **å‚æ•°åŒ–** - é€šè¿‡å‚æ•°æ§åˆ¶è¡Œä¸º
3. **é”™è¯¯å¤„ç†** - ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸æƒ…å†µ
4. **æ—¥å¿—æ¸…æ™°** - è¾“å‡ºæœ‰æ„ä¹‰çš„æ—¥å¿—ä¿¡æ¯

### 4.2 æ„å»ºç›¸å…³çš„è‡ªå®šä¹‰æ­¥éª¤


**ğŸ—ï¸ Mavenæ„å»ºæ­¥éª¤**ï¼š

`vars/buildMaven.groovy`ï¼š
```groovy
/**
 * Mavenæ„å»ºæ­¥éª¤
 * @param goals Mavenç›®æ ‡ï¼Œå¦‚ 'clean package'
 * @param profiles æ¿€æ´»çš„profileï¼Œå¯é€‰
 */
def call(String goals = 'clean package', String profiles = '') {
    echo "ğŸ—ï¸ å¼€å§‹Mavenæ„å»º..."
    
    def mvnCmd = "mvn ${goals}"
    if (profiles) {
        mvnCmd += " -P${profiles}"
    }
    
    echo "æ‰§è¡Œå‘½ä»¤ï¼š${mvnCmd}"
    
    try {
        sh mvnCmd
        echo "âœ… Mavenæ„å»ºæˆåŠŸ"
    } catch (Exception e) {
        echo "âŒ Mavenæ„å»ºå¤±è´¥ï¼š${e.message}"
        throw e
    }
}
```

**ğŸ³ Dockeræ„å»ºæ­¥éª¤**ï¼š

`vars/buildDocker.groovy`ï¼š
```groovy
def call(Map config) {
    def imageName = config.imageName ?: error("é•œåƒåç§°ä¸èƒ½ä¸ºç©º")
    def tag = config.tag ?: env.BUILD_NUMBER
    def dockerfile = config.dockerfile ?: 'Dockerfile'
    
    echo "ğŸ³ å¼€å§‹æ„å»ºDockeré•œåƒ..."
    echo "é•œåƒåç§°ï¼š${imageName}:${tag}"
    
    script {
        def image = docker.build("${imageName}:${tag}", "-f ${dockerfile} .")
        
        if (config.push) {
            echo "ğŸ“¤ æ¨é€é•œåƒåˆ°ä»“åº“..."
            image.push()
            image.push('latest')
        }
        
        return image
    }
}
```

### 4.3 éƒ¨ç½²ç›¸å…³çš„è‡ªå®šä¹‰æ­¥éª¤


**â˜¸ï¸ Kuberneteséƒ¨ç½²æ­¥éª¤**ï¼š

`vars/deployK8s.groovy`ï¼š
```groovy
def call(Map config) {
    def namespace = config.namespace ?: 'default'
    def deploymentFile = config.deploymentFile ?: error("éƒ¨ç½²æ–‡ä»¶ä¸èƒ½ä¸ºç©º")
    def imageName = config.imageName ?: error("é•œåƒåç§°ä¸èƒ½ä¸ºç©º")
    
    echo "â˜¸ï¸ å¼€å§‹Kuberneteséƒ¨ç½²..."
    echo "å‘½åç©ºé—´ï¼š${namespace}"
    echo "éƒ¨ç½²æ–‡ä»¶ï¼š${deploymentFile}"
    
    // æ›¿æ¢éƒ¨ç½²æ–‡ä»¶ä¸­çš„é•œåƒåç§°
    sh """
        sed -i 's|IMAGE_NAME|${imageName}|g' ${deploymentFile}
    """
    
    // æ‰§è¡Œéƒ¨ç½²
    sh """
        kubectl apply -f ${deploymentFile} -n ${namespace}
        kubectl rollout status deployment -n ${namespace}
    """
    
    echo "âœ… Kuberneteséƒ¨ç½²å®Œæˆ"
}
```

### 4.4 é€šçŸ¥ç›¸å…³çš„è‡ªå®šä¹‰æ­¥éª¤


**ğŸ’¬ Slacké€šçŸ¥æ­¥éª¤**ï¼š

`vars/sendSlack.groovy`ï¼š
```groovy
def call(Map config) {
    def channel = config.channel ?: '#jenkins'
    def message = config.message ?: 'æ„å»ºé€šçŸ¥'
    def color = config.color ?: 'good'
    
    def buildStatus = currentBuild.result ?: 'SUCCESS'
    def emoji = buildStatus == 'SUCCESS' ? 'âœ…' : 'âŒ'
    
    def slackMessage = """
        ${emoji} *Jenkinsæ„å»ºé€šçŸ¥*
        
        *é¡¹ç›®*: ${env.JOB_NAME}
        *æ„å»ºå·*: ${env.BUILD_NUMBER}
        *çŠ¶æ€*: ${buildStatus}
        *æ¶ˆæ¯*: ${message}
        
        <${env.BUILD_URL}|æŸ¥çœ‹è¯¦æƒ…>
    """
    
    slackSend(
        channel: channel,
        color: color,
        message: slackMessage
    )
}
```

### 4.5 å·¥å…·ç±»è‡ªå®šä¹‰æ­¥éª¤


**ğŸ“Š ä»£ç è´¨é‡æ£€æŸ¥**ï¼š

`vars/checkCodeQuality.groovy`ï¼š
```groovy
def call(Map config = [:]) {
    def sonarServer = config.sonarServer ?: 'SonarQube'
    def projectKey = config.projectKey ?: env.JOB_NAME
    
    echo "ğŸ“Š å¼€å§‹ä»£ç è´¨é‡æ£€æŸ¥..."
    
    withSonarQubeEnv(sonarServer) {
        sh """
            mvn sonar:sonar \\
                -Dsonar.projectKey=${projectKey} \\
                -Dsonar.projectName=${projectKey}
        """
    }
    
    // ç­‰å¾…è´¨é‡é—¨æ£€æŸ¥ç»“æœ
    timeout(time: 5, unit: 'MINUTES') {
        def qg = waitForQualityGate()
        if (qg.status != 'OK') {
            echo "âŒ ä»£ç è´¨é‡æ£€æŸ¥å¤±è´¥ï¼š${qg.status}"
            if (config.failOnError != false) {
                error("ä»£ç è´¨é‡ä¸ç¬¦åˆè¦æ±‚")
            }
        } else {
            echo "âœ… ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡"
        }
    }
}
```

---

## 5. ğŸ·ï¸ åº“ç‰ˆæœ¬ç®¡ç†


### 5.1 ç‰ˆæœ¬ç®¡ç†çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬ç®¡ç†**ï¼š
```
åœºæ™¯1ï¼šå¼€å‘æ–°åŠŸèƒ½
å…±äº«åº“æ·»åŠ æ–°åŠŸèƒ½ï¼Œä½†å¯èƒ½æœ‰bugï¼Œä¸èƒ½å½±å“ç”Ÿäº§ç¯å¢ƒ

åœºæ™¯2ï¼šç´§æ€¥ä¿®å¤
ç”Ÿäº§ç¯å¢ƒå‡ºé—®é¢˜ï¼Œéœ€è¦å¿«é€Ÿå›æ»šåˆ°ç¨³å®šç‰ˆæœ¬

åœºæ™¯3ï¼šæ¸è¿›å‡çº§
æ–°ç‰ˆæœ¬éœ€è¦é€æ­¥æ¨å¹¿ï¼Œä¸èƒ½ä¸€æ¬¡æ€§å…¨éƒ¨å‡çº§

åœºæ™¯4ï¼šå…¼å®¹æ€§é—®é¢˜
æ–°ç‰ˆæœ¬å¯èƒ½ä¸å…¼å®¹è€é¡¹ç›®ï¼Œéœ€è¦å¹¶è¡Œç»´æŠ¤å¤šä¸ªç‰ˆæœ¬
```

### 5.2 ç‰ˆæœ¬ç®¡ç†ç­–ç•¥


**ğŸ·ï¸ è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶**ï¼š
```
ç‰ˆæœ¬æ ¼å¼ï¼šä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆæœ¬ (1.2.3)

ä¸»ç‰ˆæœ¬(1.x.x)ï¼šä¸å…¼å®¹çš„APIä¿®æ”¹
æ¬¡ç‰ˆæœ¬(x.2.x)ï¼šå‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
ä¿®è®¢ç‰ˆæœ¬(x.x.3)ï¼šå‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

ç¤ºä¾‹ï¼š
v1.0.0 â† ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬
v1.1.0 â† æ·»åŠ æ–°åŠŸèƒ½ï¼Œå…¼å®¹v1.0.0
v1.1.1 â† ä¿®å¤bugï¼Œå…¼å®¹v1.1.0
v2.0.0 â† é‡å¤§æ›´æ–°ï¼Œå¯èƒ½ä¸å…¼å®¹v1.x.x
```

**ğŸŒ³ åˆ†æ”¯ç®¡ç†ç­–ç•¥**ï¼š
```
Gitåˆ†æ”¯ç»“æ„ï¼š
master/main     â† ç¨³å®šçš„ç”Ÿäº§ç‰ˆæœ¬
develop         â† å¼€å‘åˆ†æ”¯ï¼Œæœ€æ–°åŠŸèƒ½
feature/xxx     â† åŠŸèƒ½å¼€å‘åˆ†æ”¯
hotfix/xxx      â† ç´§æ€¥ä¿®å¤åˆ†æ”¯
release/v1.2.0  â† å‘å¸ƒå‡†å¤‡åˆ†æ”¯

å·¥ä½œæµç¨‹ï¼š
1. ä»developåˆ›å»ºfeatureåˆ†æ”¯å¼€å‘æ–°åŠŸèƒ½
2. åŠŸèƒ½å®Œæˆååˆå¹¶å›develop
3. ä»developåˆ›å»ºreleaseåˆ†æ”¯å‡†å¤‡å‘å¸ƒ
4. æµ‹è¯•é€šè¿‡ååˆå¹¶åˆ°masterå¹¶æ‰“æ ‡ç­¾
5. ç´§æ€¥é—®é¢˜ä»masteråˆ›å»ºhotfixåˆ†æ”¯ä¿®å¤
```

### 5.3 ç‰ˆæœ¬å‘å¸ƒæµç¨‹


**ğŸ“‹ æ ‡å‡†å‘å¸ƒæµç¨‹**ï¼š

1ï¸âƒ£ **å¼€å‘é˜¶æ®µ**
```bash
# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/deploy-enhancement

# å¼€å‘æ–°åŠŸèƒ½
# ç¼–å†™æµ‹è¯•
# æœ¬åœ°éªŒè¯

# æäº¤ä»£ç 
git add .
git commit -m "feat: æ·»åŠ Kuberneteséƒ¨ç½²å¢å¼ºåŠŸèƒ½"
```

2ï¸âƒ£ **æµ‹è¯•é˜¶æ®µ**
```bash
# åˆå¹¶åˆ°å¼€å‘åˆ†æ”¯
git checkout develop
git merge feature/deploy-enhancement

# åˆ›å»ºæµ‹è¯•ç‰ˆæœ¬
git tag v1.2.0-beta
git push origin v1.2.0-beta
```

3ï¸âƒ£ **å‘å¸ƒé˜¶æ®µ**
```bash
# åˆ›å»ºå‘å¸ƒåˆ†æ”¯
git checkout -b release/v1.2.0

# æœ€ç»ˆæµ‹è¯•å’Œä¿®å¤
# æ›´æ–°ç‰ˆæœ¬å·å’Œæ–‡æ¡£

# åˆå¹¶åˆ°ä¸»åˆ†æ”¯
git checkout master
git merge release/v1.2.0

# åˆ›å»ºæ­£å¼ç‰ˆæœ¬æ ‡ç­¾
git tag v1.2.0
git push origin v1.2.0
```

### 5.4 å¤šç‰ˆæœ¬å¹¶è¡Œç»´æŠ¤


**ç‰ˆæœ¬å…¼å®¹æ€§è¡¨**ï¼š

| Pipelineç‰ˆæœ¬ | **æ¨èå…±äº«åº“ç‰ˆæœ¬** | **å…¼å®¹ç‰ˆæœ¬èŒƒå›´** | **è¯´æ˜** |
|-------------|------------------|-----------------|---------|
| `Jenkins 2.400+` | `v2.x.x` | `v2.0.0 - latest` | `æ”¯æŒæœ€æ–°ç‰¹æ€§` |
| `Jenkins 2.300-2.399` | `v1.5.x` | `v1.0.0 - v1.9.x` | `ç¨³å®šåŠŸèƒ½ç‰ˆæœ¬` |
| `æ—§ç‰ˆJenkins` | `v1.0.x` | `v1.0.0 - v1.2.x` | `åŸºç¡€åŠŸèƒ½ç‰ˆæœ¬` |

**ğŸ“š ç‰ˆæœ¬ä½¿ç”¨æŒ‡å—**ï¼š
```groovy
// ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬
@Library('my-jenkins-lib@v1.2.0') _

// ä½¿ç”¨åˆ†æ”¯
@Library('my-jenkins-lib@develop') _

// ä½¿ç”¨æœ€æ–°æ ‡ç­¾
@Library('my-jenkins-lib@latest') _

// ä½¿ç”¨ä¸»åˆ†æ”¯ï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰
@Library('my-jenkins-lib') _
```

---

## 6. ğŸ”— åº“çš„ä½¿ç”¨ä¸è°ƒç”¨


### 6.1 å…±äº«åº“çš„é…ç½®æ–¹å¼


**ğŸŒ å…¨å±€é…ç½®ï¼ˆæ¨èï¼‰**ï¼š

åœ¨Jenkinsç®¡ç†ç•Œé¢é…ç½®ï¼š
```
Jenkinsç®¡ç† â†’ ç³»ç»Ÿé…ç½® â†’ Global Pipeline Libraries

é…ç½®é¡¹ï¼š
- Name: my-company-lib          â† åº“åç§°
- Default version: main         â† é»˜è®¤ç‰ˆæœ¬
- Retrieval method: Modern SCM  â† è·å–æ–¹å¼
- Source Code Management: Git   â† ä»£ç ç®¡ç†
- Repository URL: https://git.company.com/jenkins-lib.git
- Credentials: jenkins-git-user â† è®¿é—®å‡­æ®
```

**ğŸ“ æ–‡ä»¶å¤¹çº§é…ç½®**ï¼š
```
é€‚ç”¨åœºæ™¯ï¼šä¸åŒéƒ¨é—¨æœ‰ä¸åŒçš„å…±äº«åº“
é…ç½®ä½ç½®ï¼šæ–‡ä»¶å¤¹ â†’ é…ç½® â†’ Pipeline Libraries
ä¼˜å…ˆçº§ï¼šé«˜äºå…¨å±€é…ç½®ï¼Œä½äºé¡¹ç›®çº§é…ç½®
```

### 6.2 åœ¨Pipelineä¸­ä½¿ç”¨å…±äº«åº“


**ğŸ”§ åŸºæœ¬ä½¿ç”¨è¯­æ³•**ï¼š

```groovy
// æ–¹å¼1ï¼šä½¿ç”¨å…¨å±€é…ç½®çš„åº“ï¼ˆæ¨èï¼‰
@Library('my-company-lib') _

// æ–¹å¼2ï¼šä½¿ç”¨ç‰¹å®šç‰ˆæœ¬
@Library('my-company-lib@v1.2.0') _

// æ–¹å¼3ï¼šä½¿ç”¨åˆ†æ”¯
@Library('my-company-lib@develop') _

// æ–¹å¼4ï¼šä½¿ç”¨å¤šä¸ªåº“
@Library(['my-company-lib@v1.2.0', 'utils-lib@master']) _

pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                // ç›´æ¥è°ƒç”¨å…±äº«åº“å‡½æ•°
                buildMaven('clean package')
            }
        }
    }
}
```

### 6.3 å®é™…ä½¿ç”¨ç¤ºä¾‹


**ğŸš€ å®Œæ•´çš„CI/CD Pipelineç¤ºä¾‹**ï¼š

```groovy
@Library('my-company-lib@v1.5.0') _

pipeline {
    agent any
    
    environment {
        APP_NAME = 'my-web-app'
        DOCKER_REGISTRY = 'registry.company.com'
    }
    
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Build') {
            steps {
                // ä½¿ç”¨å…±äº«åº“çš„Mavenæ„å»º
                buildMaven('clean package', 'production')
            }
        }
        
        stage('Test') {
            steps {
                // ä½¿ç”¨å…±äº«åº“çš„æµ‹è¯•å‡½æ•°
                runTests([
                    testType: 'unit',
                    reportPath: 'target/test-reports'
                ])
            }
        }
        
        stage('Code Quality') {
            steps {
                // ä»£ç è´¨é‡æ£€æŸ¥
                checkCodeQuality([
                    projectKey: env.APP_NAME,
                    failOnError: true
                ])
            }
        }
        
        stage('Build Docker') {
            steps {
                script {
                    // æ„å»ºDockeré•œåƒ
                    def image = buildDocker([
                        imageName: "${DOCKER_REGISTRY}/${APP_NAME}",
                        tag: env.BUILD_NUMBER,
                        push: true
                    ])
                }
            }
        }
        
        stage('Deploy to Test') {
            steps {
                // éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
                deployK8s([
                    namespace: 'test',
                    deploymentFile: 'k8s/deployment-test.yaml',
                    imageName: "${DOCKER_REGISTRY}/${APP_NAME}:${BUILD_NUMBER}"
                ])
            }
        }
        
        stage('Deploy to Production') {
            when {
                branch 'main'
            }
            steps {
                // ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éœ€è¦å®¡æ‰¹
                script {
                    input message: 'ç¡®è®¤éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Ÿ', ok: 'éƒ¨ç½²'
                    
                    deployK8s([
                        namespace: 'production',
                        deploymentFile: 'k8s/deployment-prod.yaml',
                        imageName: "${DOCKER_REGISTRY}/${APP_NAME}:${BUILD_NUMBER}"
                    ])
                }
            }
        }
    }
    
    post {
        success {
            sendSlack([
                channel: '#deployments',
                message: "ğŸ‰ ${APP_NAME} éƒ¨ç½²æˆåŠŸï¼",
                color: 'good'
            ])
        }
        
        failure {
            sendSlack([
                channel: '#alerts',
                message: "ğŸ’¥ ${APP_NAME} æ„å»ºå¤±è´¥ï¼",
                color: 'danger'
            ])
            
            sendEmail([
                to: 'dev-team@company.com',
                subject: "æ„å»ºå¤±è´¥ï¼š${APP_NAME}",
                body: "æ„å»º #${BUILD_NUMBER} å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—ã€‚"
            ])
        }
    }
}
```

### 6.4 åŠ¨æ€åŠ è½½å…±äº«åº“


**ğŸ“¦ åœ¨Pipelineè¿è¡Œæ—¶åŠ è½½**ï¼š

```groovy
pipeline {
    agent any
    stages {
        stage('Dynamic Load') {
            steps {
                script {
                    // æ ¹æ®æ¡ä»¶åŠ¨æ€åŠ è½½ä¸åŒçš„åº“
                    if (env.BRANCH_NAME == 'main') {
                        library 'production-lib@v2.0.0'
                    } else {
                        library 'development-lib@latest'
                    }
                    
                    // ä½¿ç”¨åŠ¨æ€åŠ è½½çš„åº“
                    deployApp(env.APP_NAME, env.ENVIRONMENT)
                }
            }
        }
    }
}
```

**ğŸ”„ åº“çš„çƒ­æ›´æ–°**ï¼š
```groovy
// åœ¨ä¸é‡å¯Jenkinsçš„æƒ…å†µä¸‹ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
@Library('my-lib@' + env.LIBRARY_VERSION) _

// æˆ–è€…åœ¨Pipelineä¸­åŠ¨æ€å†³å®šç‰ˆæœ¬
script {
    def libVersion = readFile('library-version.txt').trim()
    library "my-lib@${libVersion}"
}
```

---

## 7. ğŸ¯ æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜


### 7.1 å…±äº«åº“å¼€å‘æœ€ä½³å®è·µ


**ğŸ“‹ è®¾è®¡åŸåˆ™**ï¼š

âœ… **å•ä¸€èŒè´£åŸåˆ™**
```groovy
// âŒ ä¸å¥½çš„è®¾è®¡ï¼šä¸€ä¸ªå‡½æ•°åšå¤ªå¤šäº‹æƒ…
def deployAndNotify(app, env, email, slack) {
    // æ„å»º
    // æµ‹è¯•  
    // éƒ¨ç½²
    // å‘é‚®ä»¶
    // å‘Slack
}

// âœ… å¥½çš„è®¾è®¡ï¼šåŠŸèƒ½åˆ†ç¦»
def buildApp(appName) { /* åªè´Ÿè´£æ„å»º */ }
def deployApp(appName, env) { /* åªè´Ÿè´£éƒ¨ç½² */ }
def sendNotification(config) { /* åªè´Ÿè´£é€šçŸ¥ */ }
```

âœ… **å‚æ•°éªŒè¯å’Œé»˜è®¤å€¼**
```groovy
def deployApp(Map config) {
    // å¿…éœ€å‚æ•°éªŒè¯
    def appName = config.appName ?: error("åº”ç”¨åç§°ä¸èƒ½ä¸ºç©º")
    def environment = config.environment ?: error("ç¯å¢ƒä¸èƒ½ä¸ºç©º")
    
    // å¯é€‰å‚æ•°è®¾ç½®é»˜è®¤å€¼
    def timeout = config.timeout ?: 300
    def replicas = config.replicas ?: 1
    def healthCheck = config.healthCheck ?: true
    
    echo "éƒ¨ç½²é…ç½® - åº”ç”¨:${appName}, ç¯å¢ƒ:${environment}, å‰¯æœ¬æ•°:${replicas}"
}
```

âœ… **é”™è¯¯å¤„ç†å’Œæ—¥å¿—**
```groovy
def buildDocker(imageName) {
    try {
        echo "ğŸ³ å¼€å§‹æ„å»ºDockeré•œåƒ: ${imageName}"
        
        sh "docker build -t ${imageName} ."
        
        echo "âœ… Dockeré•œåƒæ„å»ºæˆåŠŸ"
        return true
        
    } catch (Exception e) {
        echo "âŒ Dockeræ„å»ºå¤±è´¥: ${e.getMessage()}"
        
        // æ¸…ç†å¯èƒ½çš„æ®‹ç•™æ–‡ä»¶
        sh "docker system prune -f"
        
        throw e
    }
}
```

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ å‡å°‘åº“åŠ è½½æ—¶é—´**ï¼š

```groovy
// âŒ æ¯æ¬¡éƒ½åŠ è½½å®Œæ•´åº“
@Library('huge-library') _

// âœ… åªåŠ è½½éœ€è¦çš„éƒ¨åˆ†
@Library('huge-library') import com.company.deployment.K8sDeployer

// âœ… ä½¿ç”¨è½»é‡çº§çš„ä¸“ç”¨åº“
@Library('deployment-utils') _
```

**ğŸ”„ ç¼“å­˜æœºåˆ¶**ï¼š
```groovy
// åœ¨vars/withCache.groovyä¸­å®ç°ç¼“å­˜
def call(String cacheKey, Closure body) {
    def cacheDir = "/var/jenkins_cache/${cacheKey}"
    
    if (fileExists(cacheDir)) {
        echo "ğŸ“¦ ä½¿ç”¨ç¼“å­˜: ${cacheKey}"
        return readJSON file: "${cacheDir}/result.json"
    }
    
    echo "ğŸ”„ æ‰§è¡Œå¹¶ç¼“å­˜: ${cacheKey}"
    def result = body()
    
    sh "mkdir -p ${cacheDir}"
    writeJSON file: "${cacheDir}/result.json", json: result
    
    return result
}
```

### 7.3 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**â“ é—®é¢˜1ï¼šå…±äº«åº“å‡½æ•°æ‰¾ä¸åˆ°**

```
é”™è¯¯ä¿¡æ¯ï¼šNo such DSL method 'deployApp' found
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**ï¼š
```groovy
// æ£€æŸ¥äº‹é¡¹ï¼š
1. ç¡®è®¤æ–‡ä»¶ä½ç½®ï¼švars/deployApp.groovy âœ…
2. ç¡®è®¤å‡½æ•°åç§°ï¼šdef call() { } âœ…  
3. ç¡®è®¤åº“å·²æ­£ç¡®é…ç½®å’ŒåŠ è½½ âœ…
4. æ£€æŸ¥Jenkinsæ—¥å¿—ä¸­çš„åº“åŠ è½½ä¿¡æ¯ âœ…

// è°ƒè¯•æ–¹æ³•ï¼š
@Library('my-lib') _

pipeline {
    agent any
    stages {
        stage('Debug') {
            steps {
                script {
                    // åˆ—å‡ºå¯ç”¨çš„å…¨å±€å˜é‡
                    echo "å¯ç”¨å‡½æ•°: ${this.binding.variables.keySet()}"
                }
            }
        }
    }
}
```

**â“ é—®é¢˜2ï¼šæƒé™ä¸è¶³**

```
é”™è¯¯ä¿¡æ¯ï¼šScripts not permitted to use method xxx
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. æ£€æŸ¥Script Securityè®¾ç½®
   Jenkinsç®¡ç† â†’ Script Security â†’ In-process Script Approval

2. æ‰¹å‡†å¾…å®¡æ‰¹çš„è„šæœ¬æ–¹æ³•
   ç‚¹å‡»"Approve"æŒ‰é’®æ‰¹å‡†æ–¹æ³•ä½¿ç”¨

3. æˆ–è€…é…ç½®å…¨å±€ç™½åå•
   åœ¨Jenkinså¯åŠ¨å‚æ•°ä¸­æ·»åŠ ï¼š
   -Dhudson.model.DirectoryBrowserSupport.CSP=""
```

**â“ é—®é¢˜3ï¼šç‰ˆæœ¬å†²çª**

```
é—®é¢˜ï¼šä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„å…±äº«åº“ï¼ŒåŠŸèƒ½ä¸ä¸€è‡´
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**ï¼š
```groovy
// 1. åœ¨Jenkinsfileä¸­æ˜ç¡®æŒ‡å®šç‰ˆæœ¬
@Library('my-lib@v1.2.0') _  // æ˜ç¡®ç‰ˆæœ¬

// 2. ä½¿ç”¨ç¯å¢ƒå˜é‡æ§åˆ¶ç‰ˆæœ¬
@Library('my-lib@' + env.SHARED_LIB_VERSION) _

// 3. å»ºç«‹ç‰ˆæœ¬å…¼å®¹æ€§ç­–ç•¥
// åœ¨å…±äº«åº“ä¸­æ£€æŸ¥è°ƒç”¨è€…ç‰ˆæœ¬
def call(Map config) {
    def minVersion = '1.2.0'
    def currentVersion = config.libVersion ?: 'unknown'
    
    if (!isVersionCompatible(currentVersion, minVersion)) {
        error("å…±äº«åº“ç‰ˆæœ¬ ${currentVersion} ä¸å…¼å®¹ï¼Œéœ€è¦ ${minVersion} æˆ–æ›´é«˜ç‰ˆæœ¬")
    }
}
```

### 7.4 æµ‹è¯•å’Œè°ƒè¯•æŠ€å·§


**ğŸ§ª å…±äº«åº“æµ‹è¯•**ï¼š

```groovy
// åœ¨å…±äº«åº“ä¸­æ·»åŠ æµ‹è¯•å‡½æ•° vars/testLib.groovy
def call() {
    echo "ğŸ§ª å¼€å§‹æµ‹è¯•å…±äº«åº“åŠŸèƒ½..."
    
    // æµ‹è¯•å„ä¸ªå‡½æ•°
    try {
        buildMaven('--version')
        echo "âœ… buildMaven å‡½æ•°æ­£å¸¸"
    } catch (Exception e) {
        echo "âŒ buildMaven å‡½æ•°å¼‚å¸¸: ${e.message}"
    }
    
    try {
        sendEmail([to: 'test@example.com', subject: 'æµ‹è¯•'])
        echo "âœ… sendEmail å‡½æ•°æ­£å¸¸"  
    } catch (Exception e) {
        echo "âŒ sendEmail å‡½æ•°å¼‚å¸¸: ${e.message}"
    }
}
```

**ğŸ” è°ƒè¯•æŠ€å·§**ï¼š
```groovy
def call(Map config) {
    // å¯ç”¨è°ƒè¯•æ¨¡å¼
    def debug = config.debug ?: false
    
    if (debug) {
        echo "ğŸ› è°ƒè¯•ä¿¡æ¯ï¼š"
        echo "ä¼ å…¥å‚æ•°: ${config}"
        echo "ç¯å¢ƒå˜é‡: ${env}"
        echo "å½“å‰å·¥ä½œç›®å½•: ${pwd()}"
    }
    
    // å®é™…åŠŸèƒ½ä»£ç 
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å…±äº«åº“æœ¬è´¨ï¼šJenkinsä¸­çš„ä»£ç å¤ç”¨æœºåˆ¶ï¼Œé¿å…é‡å¤ç¼–å†™Pipelineä»£ç 
ğŸ”¸ ç›®å½•ç»“æ„ï¼švars(å…¨å±€å˜é‡)ã€src(æºä»£ç )ã€resources(èµ„æºæ–‡ä»¶)
ğŸ”¸ å…¨å±€å˜é‡ï¼šæ”¾åœ¨varsç›®å½•ä¸‹çš„.groovyæ–‡ä»¶ï¼Œè‡ªåŠ¨æš´éœ²ä¸ºPipelineå‡½æ•°
ğŸ”¸ ç‰ˆæœ¬ç®¡ç†ï¼šä½¿ç”¨Gitæ ‡ç­¾ç®¡ç†åº“ç‰ˆæœ¬ï¼Œæ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
ğŸ”¸ ä½¿ç”¨æ–¹å¼ï¼šé€šè¿‡@Libraryæ³¨è§£åŠ è½½ï¼Œå¯æŒ‡å®šå…·ä½“ç‰ˆæœ¬æˆ–åˆ†æ”¯
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å…±äº«åº“çš„ä»·å€¼**
```
ä»£ç å¤ç”¨ï¼šä¸€æ¬¡ç¼–å†™ï¼Œå¤šå¤„ä½¿ç”¨ï¼Œå‡å°‘é‡å¤å·¥ä½œ
æ ‡å‡†åŒ–ï¼šç»Ÿä¸€å›¢é˜Ÿçš„CI/CDæµç¨‹å’Œæœ€ä½³å®è·µ  
é›†ä¸­ç®¡ç†ï¼šä¾¿äºç»´æŠ¤å’Œå‡çº§ï¼Œé™ä½ç®¡ç†æˆæœ¬
æƒé™æ§åˆ¶ï¼šæ•æ„Ÿæ“ä½œé›†ä¸­ç®¡æ§ï¼Œæé«˜å®‰å…¨æ€§
```

**ğŸ”¹ ç›®å½•ç»“æ„çš„è®¾è®¡æ€è·¯**
```
varsç›®å½•ï¼šç®€å•ç›´æ¥ï¼Œæ–‡ä»¶åå³å‡½æ•°åï¼Œé€‚åˆå¸¸ç”¨æ“ä½œ
srcç›®å½•ï¼šå¤æ‚é€»è¾‘ï¼Œéµå¾ªJavaåŒ…ç»“æ„ï¼Œé€‚åˆå·¥å…·ç±»
resourcesç›®å½•ï¼šé™æ€èµ„æºï¼Œè„šæœ¬æ¨¡æ¿ï¼Œé…ç½®æ–‡ä»¶
```

**ğŸ”¹ ç‰ˆæœ¬ç®¡ç†çš„é‡è¦æ€§**
```
ç¨³å®šæ€§ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¨³å®šç‰ˆæœ¬ï¼Œé¿å…æ„å¤–æ•…éšœ
å…¼å®¹æ€§ï¼šæ–°è€ç‰ˆæœ¬å¹¶è¡Œï¼Œæ¸è¿›å¼å‡çº§
å¯è¿½æº¯ï¼šç‰ˆæœ¬æ ‡ç­¾è®°å½•å˜æ›´å†å²ï¼Œä¾¿äºé—®é¢˜å®šä½
å›æ»šèƒ½åŠ›ï¼šå‡ºç°é—®é¢˜æ—¶å¿«é€Ÿå›é€€åˆ°ç¨³å®šç‰ˆæœ¬
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ å¼€å‘å…±äº«åº“çš„å»ºè®®**ï¼š
- **ä»å°åšèµ·**ï¼šå…ˆå°è£…æœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œé€æ­¥æ‰©å±•
- **ä¿æŒç®€å•**ï¼šå‡½æ•°èŒè´£å•ä¸€ï¼Œå‚æ•°è®¾è®¡åˆç†
- **æ–‡æ¡£å®Œå–„**ï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜
- **æµ‹è¯•å……åˆ†**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åå†æ¨å¹¿åˆ°ç”Ÿäº§

**ğŸ¯ ä½¿ç”¨å…±äº«åº“çš„æœ€ä½³å®è·µ**ï¼š
- **ç‰ˆæœ¬å›ºå®š**ï¼šç”Ÿäº§ç¯å¢ƒæŒ‡å®šå…·ä½“ç‰ˆæœ¬ï¼Œé¿å…æ„å¤–å˜æ›´
- **åŠŸèƒ½æ¸è¿›**ï¼šæ–°åŠŸèƒ½å…ˆåœ¨éå…³é”®é¡¹ç›®è¯•ç”¨
- **ç›‘æ§ä½¿ç”¨**ï¼šå…³æ³¨å…±äº«åº“çš„ä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½è¡¨ç°
- **åŠæ—¶æ›´æ–°**ï¼šå®šæœŸå‡çº§åˆ°æ–°ç‰ˆæœ¬ï¼Œäº«å—åŠŸèƒ½æ”¹è¿›

**âš ï¸ å¸¸è§é™·é˜±é¿å…**ï¼š
- **è¿‡åº¦å°è£…**ï¼šä¸è¦ä¸ºäº†å¤ç”¨è€Œå¼ºè¡ŒæŠ½è±¡ç®€å•æ“ä½œ
- **ç‰ˆæœ¬æ··ä¹±**ï¼šä¸è¦åœ¨åŒä¸€ç¯å¢ƒä¸­æ··ç”¨å¤šä¸ªç‰ˆæœ¬
- **æƒé™è¿‡æ¾**ï¼šä¸è¦ç»™å…±äº«åº“è¿‡å¤šçš„ç³»ç»Ÿæƒé™
- **æ–‡æ¡£ç¼ºå¤±**ï¼šä¸è¦å¿½è§†ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 

### 8.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å…¥é—¨é˜¶æ®µ**ï¼š
1. ç†è§£å…±äº«åº“çš„æ¦‚å¿µå’Œä½œç”¨
2. å­¦ä¼šåˆ›å»ºç®€å•çš„å…¨å±€å˜é‡å‡½æ•°
3. æŒæ¡åŸºæœ¬çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡

**ğŸš€ è¿›é˜¶é˜¶æ®µ**ï¼š
1. å¼€å‘å¤æ‚çš„è‡ªå®šä¹‰æ­¥éª¤
2. æŒæ¡ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæµç¨‹
3. å­¦ä¼šå¤„ç†é”™è¯¯å’Œå¼‚å¸¸æƒ…å†µ

**ğŸ“ é«˜çº§é˜¶æ®µ**ï¼š
1. è®¾è®¡ä¼ä¸šçº§å…±äº«åº“æ¶æ„
2. å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²
3. ä¼˜åŒ–æ€§èƒ½å’Œç»´æŠ¤ç­–ç•¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å…±äº«åº“å¤ç”¨å¼ºï¼Œvarsç›®å½•æ˜¯ä¸»åœº
- ç‰ˆæœ¬ç®¡ç†è¦åšå¥½ï¼Œç¨³å®šç”Ÿäº§æ˜¯ç›®æ ‡  
- å‡½æ•°è®¾è®¡è¦ç®€å•ï¼Œå‚æ•°éªŒè¯ä¸èƒ½å°‘
- æµ‹è¯•æ–‡æ¡£è¦å®Œå–„ï¼Œå›¢é˜Ÿåä½œæ•ˆç‡é«˜