---
title: 4、构建结果与制品
---
## 📚 目录

1. [构建状态判断](#1-构建状态判断)
2. [构建日志查看](#2-构建日志查看)
3. [制品归档配置](#3-制品归档配置)
4. [构建历史管理](#4-构建历史管理)
5. [失败构建分析](#5-失败构建分析)
6. [构建趋势统计](#6-构建趋势统计)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🎯 构建状态判断


### 1.1 什么是构建状态


**简单理解**：构建状态就像考试成绩单，告诉你这次代码编译部署是成功了还是失败了。

```
现实生活类比：
做菜的结果 → 构建状态
✅ 菜做成功了 → Success (成功)
❌ 菜做糊了   → Failed (失败)  
🔵 还在做菜   → Building (构建中)
⚪ 没开始做   → Not Built (未构建)
```

### 1.2 常见构建状态详解


**🔸 Success (成功) - 蓝色球**
```
含义：所有步骤都正常完成
标志：蓝色圆球图标
说明：代码编译✓、测试通过✓、部署成功✓
```

**🔸 Failed (失败) - 红色球**
```
含义：某个步骤出现错误
标志：红色圆球图标
常见原因：
• 代码语法错误
• 测试用例失败
• 部署服务器连接失败
• 环境配置问题
```

**🔸 Unstable (不稳定) - 黄色球**
```
含义：构建完成但有警告
标志：黄色圆球图标
典型情况：
• 代码编译成功，但测试有部分失败
• 有告警信息但不影响主要功能
• 代码质量检查发现问题
```

**🔸 Aborted (中止) - 灰色球**
```
含义：构建被人为取消
标志：灰色圆球图标
发生场景：
• 手动点击"停止构建"
• 超时自动取消
• 资源不足被系统终止
```

### 1.3 状态查看位置


**主要查看地方**：
```
📍 项目主页面：
┌─────────────────────────────┐
│ 项目名称    [🔵] #123       │ ← 这里显示最新构建状态
│ 最后成功: #122              │
│ 最后失败: #121              │
└─────────────────────────────┘

📍 构建历史列表：
#125 🔴 Failed    2024-09-21 14:30
#124 🔵 Success   2024-09-21 14:25  
#123 🟡 Unstable  2024-09-21 14:20
#122 🔵 Success   2024-09-21 14:15
```

### 1.4 状态通知设置


**邮件通知配置**：
```
通知场景设置：
✅ 构建失败时发邮件
✅ 从失败恢复成功时发邮件
⚪ 每次构建都发邮件 (不推荐，太吵)
⚪ 只有第一次失败发邮件

收件人设置：
• 提交代码的开发者
• 项目负责人邮箱
• 团队邮件组
```

---

## 2. 📋 构建日志查看


### 2.1 构建日志是什么


**通俗解释**：构建日志就像做菜的录像回放，记录了整个构建过程中发生的每一步操作和结果。

```
做饭过程记录：           构建日志记录：
1. 洗菜 ✓               1. 拉取代码 ✓
2. 切菜 ✓               2. 编译项目 ✓  
3. 炒菜 ✓               3. 运行测试 ✓
4. 调味 ✓               4. 打包应用 ✓
5. 装盘 ✓               5. 部署上线 ✓

如果菜糊了，看录像就知道哪一步出问题了
如果构建失败，看日志就知道哪里错了
```

### 2.2 如何查看构建日志


**查看路径**：
```
步骤导航：
项目首页 → 点击构建号(如#123) → 点击"控制台输出"

或者：
项目首页 → 构建历史 → 选择构建 → Console Output
```

**日志界面说明**：
```
┌─────────────────────────────────────┐
│ Console Output - Build #123         │ ← 标题栏
├─────────────────────────────────────┤
│ Started by user admin               │ ← 谁触发的构建
│ Running as SYSTEM                   │
│ Building in workspace /var/jenkins  │ ← 工作目录
│ [Pipeline] Start of Pipeline        │ ← 开始执行
│ [Pipeline] node                     │
│ [Pipeline] {                        │
│ [Pipeline] stage ('拉取代码')        │ ← 执行阶段
│ [Pipeline] {                        │
│ ...详细执行日志...                   │
│ [Pipeline] End of Pipeline          │ ← 结束
│ Finished: SUCCESS                   │ ← 最终状态
└─────────────────────────────────────┘
```

### 2.3 日志内容解读


**🔸 正常日志特征**：
```
关键标识：
✓ "SUCCESS" - 成功完成
✓ "Finished: SUCCESS" - 最终成功
✓ 没有红色错误信息
✓ 各阶段都有开始和结束标记

示例正常日志片段：
[INFO] Scanning for projects...
[INFO] Building my-project 1.0.0
[INFO] -------- maven-clean-plugin:3.1.0:clean --------
[INFO] Deleting target
[INFO] BUILD SUCCESS
```

**🔸 错误日志特征**：
```
错误信号：
❌ "ERROR" - 明确错误
❌ "FAILED" - 失败
❌ "Exception" - 异常
❌ "BUILD FAILED" - 构建失败
❌ 退出码非0 (如: exit code 1)

示例错误日志：
[ERROR] Failed to execute goal compile
[ERROR] compilation failed: cannot find symbol
[ERROR] BUILD FAILED
[ERROR] Process exited with code 1
```

### 2.4 日志查看技巧


**🔸 快速定位错误**：
```
技巧1: 看最后几行
• 构建状态在最后显示
• 错误总结通常在末尾

技巧2: 搜索关键词
• Ctrl+F 搜索 "ERROR"
• 搜索 "FAILED"  
• 搜索 "Exception"

技巧3: 看时间戳
• 找到卡住的步骤
• 对比正常构建耗时
```

**🔸 日志过长处理**：
```
问题：日志太长看不完
解决：
1. 只看最后500行 (通常错误在末尾)
2. 按阶段查看 (如果是Pipeline)
3. 下载完整日志文件离线查看
4. 设置日志轮转 (避免日志过大)
```

---

## 3. 📦 制品归档配置


### 3.1 什么是制品归档


**生活化理解**：制品归档就像把做好的菜打包保存起来，方便以后食用或分享给别人。

```
烘焙店类比：
做蛋糕过程：面粉、鸡蛋 → 烘烤 → 成品蛋糕
制品归档：  源代码     → 构建 → 可执行文件

烘焙店会把做好的蛋糕:
✓ 包装保存 (归档制品)
✓ 贴上标签 (版本标记)  
✓ 放到展示柜 (制品仓库)
✓ 方便顾客取用 (下载部署)
```

### 3.2 常见制品类型


**🔸 不同项目的制品**：

| 项目类型 | 制品格式 | 说明 | 用途 |
|---------|---------|------|------|
| **Java项目** | `*.jar`, `*.war` | 可执行的包文件 | 直接部署运行 |
| **前端项目** | `dist/`, `build/` | 编译后的静态文件 | 上传到Web服务器 |
| **Docker项目** | `*.tar`, `镜像` | 容器镜像文件 | 容器化部署 |
| **移动应用** | `*.apk`, `*.ipa` | 安装包文件 | 发布到应用商店 |
| **文档项目** | `*.pdf`, `*.html` | 生成的文档 | 文档网站发布 |

### 3.3 归档配置方法


**🔸 在Freestyle项目中配置**：
```
配置位置：
项目配置 → 构建后操作 → 添加构建后操作步骤 → 归档制品

设置内容：
要归档的文件: target/*.jar     ← 指定要保存的文件
排除文件: target/*-sources.jar  ← 排除不需要的文件
```

**🔸 在Pipeline中配置**：
```groovy
pipeline {
    agent any
    stages {
        stage('构建') {
            steps {
                sh 'mvn clean package'  // 执行构建
            }
        }
        stage('归档') {
            steps {
                // 归档制品 - 保存构建结果
                archiveArtifacts artifacts: 'target/*.jar', 
                                fingerprint: true
                                
                // 如果需要排除某些文件
                archiveArtifacts artifacts: 'target/*.jar', 
                                excludes: 'target/*-sources.jar'
            }
        }
    }
}
```

### 3.4 归档配置参数说明


**🔸 关键参数解释**：
```
artifacts: 'target/*.jar'
├─ 含义: 要归档的文件路径模式
├─ 支持通配符: * (任意文件名), ** (任意路径)
├─ 示例: 
│   ├─ target/*.jar (target目录下所有jar文件)
│   ├─ dist/**/* (dist目录及子目录下所有文件)
│   └─ *.zip,*.tar.gz (多种格式文件)

fingerprint: true  
├─ 含义: 生成文件指纹 (MD5值)
├─ 作用: 跟踪文件变化，确保文件唯一性
└─ 建议: 建议开启，便于版本管理

allowEmptyArchive: true
├─ 含义: 允许没有找到匹配文件
├─ 默认: false (没找到文件会构建失败)  
└─ 使用: 可选制品时设为true
```

### 3.5 制品查看和下载


**🔸 查看已归档制品**：
```
查看路径：
项目首页 → 点击构建号 → 构建制品 (Build Artifacts)

界面显示：
┌─────────────────────────────┐
│ Build Artifacts             │
├─────────────────────────────┤
│ 📁 target/                  │
│   └── 📄 my-app-1.0.jar    │ ← 点击可下载
│       (2.3 MB)             │
│                             │
│ 📄 README.txt              │
│   (1.2 KB)                 │
└─────────────────────────────┘
```

**🔸 制品下载方式**：
```
方式1: 网页直接下载
• 点击文件名直接下载
• 适合偶尔下载使用

方式2: REST API下载  
• GET /job/{job}/lastSuccessfulBuild/artifact/{path}
• 适合自动化脚本

方式3: 命令行下载
wget http://jenkins-server/job/my-project/lastBuild/artifact/target/app.jar
```

---

## 4. 📈 构建历史管理


### 4.1 构建历史的作用


**简单理解**：构建历史就像银行流水账，记录了每一次构建的详细信息，方便追溯和分析。

```
银行账户类比：
银行流水 → 构建历史
每笔交易 → 每次构建
交易时间 → 构建时间  
交易金额 → 构建结果
交易备注 → 提交信息

通过流水可以：
✓ 查看账户变化 → 查看项目演进
✓ 发现异常交易 → 发现构建问题
✓ 分析消费习惯 → 分析构建趋势
```

### 4.2 构建历史信息内容


**🔸 每次构建记录包含**：
```
基本信息：
• 构建编号: #123
• 构建时间: 2024-09-21 14:30:00
• 构建状态: Success/Failed/Unstable
• 构建用时: 2分30秒
• 触发方式: 手动/定时/代码提交

详细信息：  
• 代码版本: commit abc123...
• 构建节点: master/slave-01
• 构建参数: branch=main, env=prod
• 制品大小: 2.3MB
• 测试结果: 15个测试全部通过
```

### 4.3 历史记录保留策略


**🔸 为什么要设置保留策略**：
```
问题：构建历史会越来越多
影响：
• 占用磁盘空间
• 页面加载变慢
• 查找变困难

解决：设置合理的保留规则
```

**🔸 保留策略配置**：
```
配置位置：
项目配置 → 常规 → 丢弃旧的构建

保留选项：
┌─────────────────────────────┐
│ ✅ 丢弃旧的构建              │
│                             │
│ 保持构建的天数: [30]        │ ← 保留30天内的构建
│ 保持构建的最大个数: [50]    │ ← 最多保留50个构建
│                             │
│ ✅ 保持构建制品              │
│ 保持制品的天数: [7]         │ ← 制品只保留7天
│ 保持制品的最大个数: [10]    │ ← 最多保留10个制品
└─────────────────────────────┘
```

**🔸 推荐保留策略**：
```
不同项目类型建议：

开发项目 (频繁构建):
• 保留天数: 30天
• 保留个数: 50个
• 制品保留: 10个

生产项目 (重要项目):
• 保留天数: 90天  
• 保留个数: 100个
• 制品保留: 20个

测试项目 (临时项目):
• 保留天数: 7天
• 保留个数: 20个
• 制品保留: 5个
```

### 4.4 历史记录查看技巧


**🔸 快速筛选查看**：
```
查看方式：
项目首页 → 构建历史 → 点击构建号

筛选技巧：
• 只看成功构建: 点击蓝色球
• 只看失败构建: 点击红色球  
• 按时间范围: 使用日期筛选
• 按触发人: 查看特定开发者的构建
```

**🔸 批量操作**：
```
批量删除构建：
1. 进入"管理Jenkins" → "脚本命令行"
2. 输入Groovy脚本删除指定构建
3. 谨慎操作，删除后无法恢复

批量下载制品：
• 使用Jenkins CLI命令
• 编写自动化脚本
• 通过REST API批量获取
```

---

## 5. 🔍 失败构建分析


### 5.1 分析失败构建的重要性


**现实类比**：失败构建分析就像医生看病，通过症状(错误日志)找到病因(问题根源)，对症下药(解决问题)。

```
看病流程 → 构建失败分析
听症状描述 → 查看构建状态
量体温血压 → 检查构建日志  
化验检查   → 深入分析错误
找到病因   → 定位问题原因
开药治疗   → 修复问题代码
复查确认   → 重新构建验证
```

### 5.2 常见失败类型分析


**🔸 编译错误 (Compilation Failed)**
```
错误特征：
[ERROR] compilation failed: cannot find symbol
[ERROR] package com.example does not exist

常见原因：
• 代码语法错误
• 缺少依赖包
• 导入路径错误
• 版本不兼容

解决思路：
1. 检查本地是否能正常编译
2. 确认依赖版本是否正确
3. 检查环境变量配置
4. 对比上次成功构建的差异
```

**🔸 测试失败 (Test Failed)**
```
错误特征：
Tests run: 10, Failures: 2, Errors: 0, Skipped: 0
[ERROR] testUserLogin failed: expected 200 but got 404

常见原因：
• 代码逻辑错误
• 测试数据问题
• 环境配置差异
• 服务依赖不可用

解决思路：
1. 单独运行失败的测试
2. 检查测试环境配置
3. 确认测试数据是否正确
4. 检查外部服务是否可用
```

**🔸 部署失败 (Deployment Failed)**
```
错误特征：
Connection refused: connect
Permission denied: /opt/app/deploy.sh
No space left on device

常见原因：
• 目标服务器连接问题
• 权限不足
• 磁盘空间不足
• 端口被占用

解决思路：
1. 检查服务器连接状态
2. 确认部署权限配置
3. 检查服务器资源使用情况
4. 验证部署脚本正确性
```

### 5.3 失败分析步骤


**🔸 标准分析流程**：
```
第一步: 快速判断
├─ 查看构建状态和时间
├─ 对比上次成功构建
└─ 确定失败阶段 (编译/测试/部署)

第二步: 日志分析  
├─ 重点看最后100行日志
├─ 搜索ERROR、FAILED关键词
└─ 记录具体错误信息

第三步: 环境检查
├─ 确认构建环境状态
├─ 检查依赖服务可用性  
└─ 验证配置参数正确性

第四步: 代码对比
├─ 查看最近提交的代码变更
├─ 确认变更是否引入问题
└─ 必要时回滚到上一版本

第五步: 问题修复
├─ 根据分析结果修复问题
├─ 本地验证修复效果
└─ 重新触发构建验证
```

### 5.4 失败模式识别


**🔸 间歇性失败**
```
特征：时好时坏，成功率不稳定
原因：
• 网络不稳定
• 资源竞争
• 时间相关的测试
• 外部服务不稳定

处理：
• 增加重试机制
• 优化测试用例
• 加强环境监控
• 使用更稳定的依赖
```

**🔸 环境相关失败**
```
特征：本地成功，Jenkins失败
原因：
• 环境配置不一致
• 路径差异
• 权限问题
• 工具版本不同

处理：  
• 统一开发和构建环境
• 使用容器化构建
• 标准化工具版本
• 详细的环境文档
```

---

## 6. 📊 构建趋势统计


### 6.1 什么是构建趋势


**生活化理解**：构建趋势就像体检报告的历史对比，通过数据图表看出项目"健康状况"的变化趋势。

```
体检报告类比：
血压变化图 → 构建成功率趋势
体重记录   → 构建时长变化
化验指标   → 测试通过率
医生建议   → 优化改进方向

通过趋势分析可以：
✓ 发现规律 (什么时候容易失败)
✓ 预防问题 (提前发现潜在风险)  
✓ 优化效率 (改进构建速度)
✓ 管理决策 (是否需要投入资源)
```

### 6.2 Jenkins内置趋势图表


**🔸 构建结果趋势**
```
位置：项目首页右侧 "Build History Trend"

显示内容：
┌─────────────────────────────┐
│    构建结果趋势图            │
│ 100%┤                       │
│     │ ████████████████      │ ← 成功率
│  50%│     ░░░░              │ ← 失败率  
│     │                       │
│   0%└─────────────────────── │
│     1周前  3天前  今天       │
└─────────────────────────────┘

颜色含义：
🔵 蓝色: 成功构建
🔴 红色: 失败构建  
🟡 黄色: 不稳定构建
⚪ 灰色: 取消构建
```

**🔸 构建时长趋势**
```
显示信息：
• 平均构建时间变化
• 最长构建时间记录
• 构建时间分布情况

分析价值：
• 发现性能回退
• 评估优化效果
• 规划构建资源
```

### 6.3 高级趋势分析


**🔸 测试结果趋势**
```
需要安装插件: JUnit Plugin

趋势内容：
┌─────────────────────────────┐
│      测试结果趋势           │
│ 总数┤ ████████████████████   │ ← 测试总数  
│     │ ████████████████████   │ ← 通过数量
│通过 │ ░░░░                   │ ← 失败数量
│     │                        │
│ 失败└─────────────────────── │
│     最近10次构建            │
└─────────────────────────────┘

关键指标：
• 测试通过率变化
• 新增/修复的测试数量  
• 测试执行时间趋势
```

**🔸 代码质量趋势**
```
需要SonarQube等代码质量工具

监控指标：
• 代码覆盖率变化
• 代码复杂度趋势
• 技术债务统计
• 安全漏洞数量

趋势意义：
• 代码质量是否在提升
• 技术债务是否在累积
• 团队开发习惯是否改善
```

### 6.4 趋势数据的实际应用


**🔸 团队效率评估**
```
关键指标组合：
构建成功率 + 构建频率 + 修复时间

高效团队特征：
✓ 构建成功率 > 90%
✓ 每天多次构建提交
✓ 问题修复时间 < 2小时
✓ 趋势稳定向好

问题团队信号：
❌ 成功率持续下降
❌ 构建频率很低
❌ 失败后长时间不修复
❌ 时长持续增加
```

**🔸 项目健康度监控**
```
健康项目指标：
┌─────────────────────────────┐
│ 项目健康度仪表盘             │
├─────────────────────────────┤
│ 构建成功率: 95% ✅           │
│ 平均构建时长: 3分钟 ✅       │  
│ 测试覆盖率: 80% ✅           │
│ 代码质量评分: A ✅           │
│                             │
│ 整体健康度: 优秀 🌟          │
└─────────────────────────────┘

预警信号：
🔴 成功率低于80%
🟡 构建时长超过10分钟
🟡 测试覆盖率低于60%
🔴 连续3天构建失败
```

**🔸 优化决策支持**
```
基于趋势的优化建议：

构建时长持续增加 → 
• 优化构建脚本
• 增加并行执行
• 升级构建服务器

失败率突然上升 → 
• 加强代码审查
• 改进测试策略  
• 强化环境管理

测试时间过长 →
• 优化测试用例
• 实施分层测试
• 并行测试执行
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本概念


```
🔸 构建状态：Success(蓝) > Unstable(黄) > Failed(红) > Aborted(灰)
🔸 构建日志：问题诊断的第一手资料，重点看ERROR和FAILED
🔸 制品归档：保存构建结果，便于部署和分发
🔸 历史管理：合理保留策略，平衡存储和可追溯性
🔸 失败分析：系统化排查，快速定位和解决问题
🔸 趋势统计：数据驱动改进，预防问题发生
```

### 7.2 关键理解要点


**🔹 构建状态的判断逻辑**
```
状态判断优先级：
任何步骤失败 → Failed
测试有失败但不影响主流程 → Unstable  
所有步骤成功 → Success
人为中断 → Aborted

理解重点：
• Unstable不等于失败，但需要关注
• 状态会影响后续自动化流程
• 不同状态需要不同的处理策略
```

**🔹 日志分析的技巧**
```
高效分析方法：
1. 先看结论 (最后几行)
2. 再找原因 (搜索ERROR)  
3. 对比差异 (与成功构建对比)
4. 重现问题 (本地验证)

常见陷阱：
• 被无关警告干扰
• 只看表面错误不看根因
• 忽略环境差异
```

**🔹 制品管理的策略**
```
制品分类管理：
• 发布版本: 长期保存
• 开发版本: 短期保存
• 测试版本: 临时保存

存储优化：
• 压缩大文件
• 清理临时文件
• 使用外部存储
```

### 7.3 实际应用价值


**🎯 日常开发工作**
- **快速反馈**：及时发现代码问题，减少修复成本
- **质量保障**：通过趋势分析持续改进代码质量
- **协作效率**：团队成员都能快速了解项目状态
- **问题追溯**：历史记录帮助快速定位问题引入时间

**🔧 运维管理**
- **自动化部署**：制品归档支持自动化发布流程
- **资源规划**：趋势数据指导服务器资源分配
- **故障处理**：完整日志支持快速故障定位
- **容量管理**：合理的保留策略控制存储成本

**核心记忆口诀**：
```
状态看球色，成功蓝失败红
日志找ERROR，最后几行是重点  
制品要归档，版本管理很重要
历史记录全，趋势分析助改进
失败别慌张，系统分析找根因
```