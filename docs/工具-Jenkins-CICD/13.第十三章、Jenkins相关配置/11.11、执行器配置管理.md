---
title: 11、执行器配置管理
---
## 📚 目录

1. [执行器基础概念](#1-执行器基础概念)
2. [执行器数量配置](#2-执行器数量配置)
3. [执行器使用模式设置](#3-执行器使用模式设置)
4. [工作空间配置参数](#4-工作空间配置参数)
5. [执行器超时配置](#5-执行器超时配置)
6. [并发执行限制设置](#6-并发执行限制设置)
7. [执行器资源配置](#7-执行器资源配置)
8. [执行器日志配置](#8-执行器日志配置)
9. [执行器清理策略](#9-执行器清理策略)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🎯 执行器基础概念


### 1.1 什么是Jenkins执行器


**🔍 通俗理解**
```
执行器就像工厂里的生产线：
🏭 Jenkins主服务器 = 工厂总部（管理调度）
⚙️ 执行器 = 生产线（实际干活的地方）
📦 构建任务 = 产品订单（需要完成的工作）

一个Jenkins可以有多条"生产线"同时工作
每条生产线都可以独立完成一个构建任务
```

**📋 核心定义**
- **执行器（Executor）**：Jenkins中实际执行构建任务的工作单元
- **节点（Node）**：可以运行执行器的计算机（包括主节点和从节点）
- **主节点（Master Node）**：Jenkins服务器本身
- **从节点（Slave/Agent Node）**：连接到Jenkins的其他机器

### 1.2 执行器的工作原理


```
Jenkins任务执行流程：
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  任务队列    │───▶│   执行器     │───▶│  构建结果    │
│ (排队等待)   │    │ (正在执行)   │    │ (完成输出)   │
└─────────────┘    └─────────────┘    └─────────────┘
      ↑                   │
      │              ┌─────────────┐
      └──────────────│  工作空间    │
                     │ (临时文件)   │
                     └─────────────┘
```

**💡 关键理解**
- 每个执行器在执行时会创建独立的工作空间
- 执行器可以分布在不同的机器上
- 执行器数量决定了Jenkins的并发处理能力

---

## 2. ⚙️ 执行器数量配置


### 2.1 配置位置与方法


**🔧 主节点执行器配置**
```
配置路径：
Jenkins首页 → 系统管理 → 节点管理 → Built-In Node → 配置

关键参数：
┌─ 执行器数量设置 ──────────────┐
│ 执行器数量: [4]               │
│ □ 尽可能使用这个节点          │
│ ☑ 只构建有标签限制的项目      │
└───────────────────────────────┘
```

### 2.2 执行器数量计算原则


**📊 推荐配置公式**
```
💻 基本配置建议：
┌─────────────────────────────────┐
│ 服务器类型    | 推荐执行器数量  │
├─────────────────────────────────┤
│ 开发测试环境  | CPU核心数      │
│ 生产环境      | CPU核心数 × 2   │
│ 高负载环境    | CPU核心数 + 2   │
│ 资源受限环境  | CPU核心数 ÷ 2   │
└─────────────────────────────────┘

🎯 实际考虑因素：
• CPU核心数
• 内存大小
• 磁盘IO性能
• 网络带宽
• 构建任务类型
```

**💡 配置示例说明**
```
场景1：4核8G开发服务器
推荐配置：3-4个执行器
原因：为系统预留1个核心，避免过载

场景2：8核16G生产服务器  
推荐配置：6-8个执行器
原因：充分利用资源，提高并发能力

场景3：2核4G测试服务器
推荐配置：1-2个执行器
原因：资源有限，避免系统卡顿
```

### 2.3 动态调整策略


**🔄 监控与调整**
```
监控指标：
✅ CPU使用率 < 80%
✅ 内存使用率 < 85%  
✅ 磁盘IO等待 < 20%
✅ 执行器利用率 > 70%

调整原则：
如果系统资源充足但执行器经常空闲 → 增加执行器
如果系统经常过载或构建很慢 → 减少执行器
如果经常有任务排队等待 → 考虑增加执行器
```

---

## 3. 🎛️ 执行器使用模式设置


### 3.1 使用模式类型


**📋 两种主要模式**
```
模式1：尽可能使用这个节点
┌─ 特点 ─────────────────────┐
│ • 任何任务都可以在此执行   │
│ • 节点充分利用             │
│ • 适合通用构建环境         │
└────────────────────────────┘

模式2：只构建有标签限制的项目
┌─ 特点 ─────────────────────┐
│ • 只执行特定标签的任务     │
│ • 专用环境配置             │
│ • 适合特殊需求或主节点     │
└────────────────────────────┘
```

### 3.2 使用模式选择指南


**🎯 主节点推荐配置**
```
主节点建议选择："只构建有标签限制的项目"

原因：
📍 主节点负责调度管理，不宜承担重负载
📍 避免构建任务影响Jenkins核心服务
📍 保证系统稳定性和响应速度
📍 便于集中管理和监控
```

**⚡ 从节点推荐配置**
```
从节点建议选择："尽可能使用这个节点"

原因：
📍 从节点专门用于执行构建任务
📍 充分利用计算资源
📍 提高整体构建效率
📍 分担主节点压力
```

### 3.3 标签配置策略


**🏷️ 标签命名规范**
```
环境标签：
- prod（生产环境）
- test（测试环境）  
- dev（开发环境）

技术标签：
- java（Java项目）
- nodejs（Node.js项目）
- docker（支持Docker）

硬件标签：
- high-cpu（高CPU性能）
- high-memory（大内存）
- ssd（SSD硬盘）
```

---

## 4. 📁 工作空间配置参数


### 4.1 工作空间基本概念


**🔍 工作空间是什么**
```
工作空间就像每个项目的"临时办公室"：
┌─ 项目A工作空间 ─────────┐
│ /var/jenkins_home/      │
│ workspace/ProjectA/     │
│ ├── 源代码文件          │
│ ├── 编译产物            │
│ └── 临时文件            │
└─────────────────────────┘

每个项目都有独立的工作空间
构建时在这里下载代码、编译、测试
```

### 4.2 工作空间路径配置


**📂 默认路径结构**
```
主节点工作空间：
/var/jenkins_home/workspace/

从节点工作空间：
/home/jenkins/workspace/

具体项目路径：
${工作空间根目录}/${项目名称}/
```

**🔧 自定义工作空间配置**
```
配置方法：
1. 进入节点配置页面
2. 高级设置 → 远程工作目录
3. 设置自定义路径

示例配置：
┌─ 路径配置 ─────────────────┐
│ 远程工作目录：              │
│ /opt/jenkins-workspace     │
│                            │
│ 临时目录：                 │
│ /tmp/jenkins-tmp           │
└────────────────────────────┘
```

### 4.3 工作空间清理策略


**🧹 清理时机配置**
```
清理策略选项：
☑ 构建前删除工作空间
☑ 构建后删除工作空间  
☑ 构建失败时保留工作空间
☑ 定期清理旧的工作空间
```

**💾 磁盘空间管理**
```
监控指标：
- 工作空间总大小
- 各项目空间占用
- 磁盘剩余空间

清理建议：
✅ 每日构建项目：构建后清理
✅ 调试项目：构建失败时保留
✅ 归档项目：定期批量清理
```

---

## 5. ⏰ 执行器超时配置


### 5.1 超时配置的重要性


**⚠️ 为什么需要超时配置**
```
问题场景：
🔴 构建任务卡死不结束
🔴 占用执行器无法释放
🔴 影响其他任务排队执行
🔴 浪费系统资源

超时配置的作用：
✅ 自动终止长时间运行的任务
✅ 释放被占用的执行器
✅ 提高系统整体效率
✅ 避免资源浪费
```

### 5.2 超时配置方法


**🔧 全局超时设置**
```
配置路径：
系统管理 → 系统配置 → 全局属性

超时参数：
┌─ 全局超时设置 ─────────────┐
│ 默认构建超时：60分钟        │
│ 最大允许超时：120分钟       │
│ 超时处理方式：终止构建      │
└────────────────────────────┘
```

**⚙️ 项目级超时设置**
```
配置路径：
项目配置 → 构建环境 → 构建超时

具体配置：
┌─ 项目超时配置 ─────────────┐
│ ☑ 启用构建超时             │
│ 超时策略：绝对超时          │
│ 超时时间：30分钟            │
│ 超时动作：中止构建          │
└────────────────────────────┘
```

### 5.3 超时时间设置建议


**📊 不同项目类型的超时建议**
```
┌─────────────────────────────────────┐
│ 项目类型        | 建议超时时间      │
├─────────────────────────────────────┤
│ 单元测试        | 5-10分钟         │
│ 代码编译        | 10-20分钟        │
│ 集成测试        | 20-30分钟        │
│ 部署任务        | 15-25分钟        │
│ 大型项目构建    | 30-60分钟        │
│ 端到端测试      | 45-90分钟        │
└─────────────────────────────────────┘
```

---

## 6. 🚦 并发执行限制设置


### 6.1 并发限制的必要性


**🔍 为什么要限制并发**
```
资源竞争问题：
🔴 多个任务同时访问数据库
🔴 磁盘IO过载导致系统卡顿
🔴 网络带宽被占满
🔴 内存不足导致构建失败

限制并发的好处：
✅ 避免资源争抢
✅ 保证构建质量
✅ 提高成功率
✅ 系统运行稳定
```

### 6.2 并发限制配置


**⚙️ 全局并发限制**
```
配置位置：
系统管理 → 插件管理 → Throttle Concurrent Builds

基本配置：
┌─ 全局限制设置 ─────────────┐
│ 最大并发构建数：4          │
│ 每个节点最大构建数：2      │
│ 每个项目最大构建数：1      │
└────────────────────────────┘
```

**🎯 项目级并发限制**
```
配置方法：
项目配置 → 构建环境 → 限制并发构建

具体设置：
┌─ 项目并发限制 ─────────────┐
│ ☑ 启用构建限制             │
│ 限制类型：按项目分类        │
│ 最大并发数：1              │
│ 限制范围：所有节点          │
└────────────────────────────┘
```

### 6.3 并发策略设计


**📋 常用并发策略**
```
策略1：按项目类型分组
数据库相关项目：最多1个并发
前端项目：最多3个并发
测试项目：最多2个并发

策略2：按环境分离
生产部署：最多1个并发
测试环境：最多2个并发
开发环境：不限制并发

策略3：按资源需求
高CPU项目：最多2个并发
高内存项目：最多1个并发
普通项目：最多4个并发
```

---

## 7. 💻 执行器资源配置


### 7.1 CPU资源配置


**⚙️ CPU限制设置**
```
配置方法：
通过Jenkins系统属性或Docker限制

Java系统属性：
-Djava.util.concurrent.ForkJoinPool.common.parallelism=4

Docker资源限制：
--cpus="2.0"
--cpu-shares=1024
```

**📊 CPU使用监控**
```
监控工具：
- Jenkins内置监控
- 系统监控命令：top, htop
- 专业监控：Prometheus + Grafana

关键指标：
✅ CPU使用率 < 80%
✅ 负载平均值 < CPU核心数
✅ 上下文切换频率适中
```

### 7.2 内存资源配置


**🔧 内存限制参数**
```
Jenkins JVM内存设置：
-Xms2g -Xmx4g -XX:MaxPermSize=256m

执行器内存限制：
每个执行器建议分配：1-2GB内存

Docker内存限制：
--memory="2g"
--memory-swap="4g"
```

**📈 内存使用优化**
```
优化策略：
┌─ 内存优化建议 ─────────────┐
│ • 定期清理构建历史         │
│ • 限制日志文件大小         │
│ • 使用内存映射文件         │
│ • 配置垃圾回收参数         │
└────────────────────────────┘
```

### 7.3 磁盘IO优化


**💾 磁盘配置建议**
```
工作空间配置：
- 使用SSD硬盘提高IO性能
- 分离系统盘和数据盘
- 配置RAID提高可靠性

临时文件配置：
- 设置专用临时目录
- 定期清理临时文件
- 使用内存文件系统（如果内存充足）
```

---

## 8. 📋 执行器日志配置


### 8.1 日志级别配置


**🔧 日志级别设置**
```
配置路径：
系统管理 → 系统日志 → 日志记录器

常用日志级别：
┌─ 日志级别配置 ─────────────┐
│ SEVERE  - 严重错误         │
│ WARNING - 警告信息         │
│ INFO    - 一般信息         │
│ FINE    - 详细信息         │
│ FINEST  - 最详细信息       │
└────────────────────────────┘
```

**📊 推荐日志配置**
```
生产环境：INFO级别
测试环境：FINE级别
开发调试：FINEST级别

特定组件日志：
- hudson.model.Run: INFO
- hudson.slaves: WARNING  
- hudson.model.Queue: INFO
```

### 8.2 日志文件管理


**📁 日志文件配置**
```
日志文件路径：
$JENKINS_HOME/logs/

主要日志文件：
jenkins.log - 主服务日志
gc.log - 垃圾回收日志
access.log - 访问日志
```

**🗂️ 日志轮转配置**
```
配置示例：
┌─ 日志轮转设置 ─────────────┐
│ 最大文件大小：100MB        │
│ 保留文件数量：10个         │
│ 压缩旧文件：是            │
│ 轮转周期：每日            │
└────────────────────────────┘
```

### 8.3 构建日志配置


**📝 构建日志设置**
```
输出格式配置：
- 时间戳显示
- 颜色高亮（ANSI Color）
- 日志级别标识

大小限制：
- 单个构建日志：最大50MB
- 总日志存储：最大1GB
- 自动清理策略
```

---

## 9. 🧹 执行器清理策略


### 9.1 自动清理配置


**⚙️ 清理策略设置**
```
配置位置：
系统管理 → 系统配置 → 丢弃旧的构建

清理参数：
┌─ 构建清理策略 ─────────────┐
│ 保留构建天数：30天         │
│ 保留构建个数：50个         │
│ 保留制品天数：7天          │
│ 保留制品个数：10个         │
└────────────────────────────┘
```

**🗑️ 清理内容范围**
```
清理内容包括：
✅ 构建历史记录
✅ 构建日志文件  
✅ 工作空间文件
✅ 构建制品文件
✅ 临时文件

保留内容：
📌 配置信息
📌 用户数据
📌 插件数据
📌 系统配置
```

### 9.2 手动清理操作


**🛠️ 清理工具使用**
```
内置清理工具：
系统管理 → 脚本命令行

清理脚本示例：
// 清理超过30天的构建
Jenkins.instance.getAllItems(Job).each { job ->
  job.builds.findAll { 
    it.timestamp.before(Calendar.getInstance().time - 30)
  }.each { 
    it.delete() 
  }
}
```

### 9.3 定期维护计划


**📅 维护计划建议**
```
日常维护（每日）：
☐ 检查磁盘空间使用
☐ 清理临时文件
☐ 检查执行器状态

周度维护（每周）：
☐ 清理旧的构建记录
☐ 检查系统性能
☐ 更新系统补丁

月度维护（每月）：
☐ 深度清理存储空间
☐ 优化数据库
☐ 备份配置文件
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心概念


```
🎯 执行器本质：Jenkins中实际执行构建任务的工作单元
🎯 数量配置：根据CPU核心数和系统资源合理设置
🎯 使用模式：主节点用标签限制，从节点充分利用
🎯 超时配置：避免任务卡死，及时释放资源
🎯 并发限制：防止资源争抢，保证构建质量
🎯 资源管理：CPU、内存、磁盘的合理分配
🎯 日志配置：便于问题排查和系统监控
🎯 清理策略：定期清理，保持系统健康
```

### 10.2 配置最佳实践


**🔧 推荐配置模板**
```
┌─ 标准配置建议 ─────────────────────┐
│                                    │
│ 🖥️ 主节点配置：                   │
│ • 执行器数量：1-2个                │
│ • 使用模式：只构建有标签限制的项目  │
│ • 超时时间：30分钟                 │
│                                    │
│ 🔧 从节点配置：                   │
│ • 执行器数量：CPU核心数            │
│ • 使用模式：尽可能使用这个节点     │
│ • 超时时间：根据项目类型设置       │
│                                    │
│ 🗂️ 清理策略：                     │
│ • 保留构建：30天或50个             │
│ • 清理周期：每日自动               │
│ • 监控告警：磁盘使用率>80%         │
│                                    │
└────────────────────────────────────┘
```

### 10.3 常见问题与解决


**❓ 执行器配置常见问题**
```
问题1：构建排队时间长
解决：增加执行器数量或优化并发策略

问题2：系统运行缓慢
解决：减少执行器数量或升级硬件

问题3：构建经常超时
解决：调整超时时间或优化构建脚本

问题4：磁盘空间不足
解决：配置自动清理或增加存储空间

问题5：构建冲突
解决：设置合理的并发限制
```

### 10.4 监控与优化建议


**📊 关键监控指标**
```
系统性能指标：
📈 CPU使用率：< 80%
📈 内存使用率：< 85%
📈 磁盘使用率：< 80%
📈 网络带宽：< 70%

构建效率指标：
📊 执行器利用率：> 70%
📊 平均排队时间：< 5分钟
📊 构建成功率：> 95%
📊 平均构建时间：稳定
```

**🎯 优化策略总结**
- **资源匹配**：执行器数量与硬件资源匹配
- **合理分工**：主节点管理，从节点执行  
- **定期清理**：避免垃圾文件占用空间
- **监控告警**：及时发现和解决问题
- **持续优化**：根据使用情况调整配置

**核心记忆要点**：
- 执行器是Jenkins的"干活工人"，合理配置才能高效工作
- 主节点负责管理，不宜承担重负载构建任务
- 超时和并发限制是保护系统稳定的重要措施
- 定期清理和监控是保持系统健康的关键