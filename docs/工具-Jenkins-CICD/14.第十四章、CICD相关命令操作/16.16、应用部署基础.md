---
title: 16ã€åº”ç”¨éƒ¨ç½²åŸºç¡€
---
## ğŸ“š ç›®å½•

1. [åº”ç”¨éƒ¨ç½²åŸºç¡€æ¦‚å¿µ](#1-åº”ç”¨éƒ¨ç½²åŸºç¡€æ¦‚å¿µ)
2. [SSHè¿œç¨‹éƒ¨ç½²é…ç½®](#2-SSHè¿œç¨‹éƒ¨ç½²é…ç½®)
3. [éƒ¨ç½²è„šæœ¬ç¼–å†™å®æˆ˜](#3-éƒ¨ç½²è„šæœ¬ç¼–å†™å®æˆ˜)
4. [æœåŠ¡å¯åœä¸ç®¡ç†](#4-æœåŠ¡å¯åœä¸ç®¡ç†)
5. [é…ç½®æ–‡ä»¶ç®¡ç†ç­–ç•¥](#5-é…ç½®æ–‡ä»¶ç®¡ç†ç­–ç•¥)
6. [éƒ¨ç½²éªŒè¯ä¸å›æ»š](#6-éƒ¨ç½²éªŒè¯ä¸å›æ»š)
7. [éƒ¨ç½²æ—¥å¿—ä¸ç›‘æ§](#7-éƒ¨ç½²æ—¥å¿—ä¸ç›‘æ§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ åº”ç”¨éƒ¨ç½²åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åº”ç”¨éƒ¨ç½²


**ğŸ”¸ ç®€å•ç†è§£**
```
æŠŠä½ å¼€å‘å¥½çš„ç¨‹åº"æ¬"åˆ°æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå°±åƒæ¬å®¶ä¸€æ ·ï¼š
- æœ¬åœ°å¼€å‘ = åœ¨å®¶é‡Œè£…ä¿®æˆ¿å­
- åº”ç”¨éƒ¨ç½² = æŠŠè£…ä¿®å¥½çš„å®¶å…·æ¬åˆ°æ–°æˆ¿å­
- è®©ç”¨æˆ·è®¿é—® = é‚€è¯·å®¢äººåˆ°æ–°æˆ¿å­åšå®¢
```

**ğŸ’¡ éƒ¨ç½²çš„æœ¬è´¨ç›®çš„**
- **è®©ç¨‹åºè·‘èµ·æ¥**ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ­£å¸¸è¿è¡Œä½ çš„åº”ç”¨
- **è®©ç”¨æˆ·èƒ½è®¿é—®**ï¼šé€šè¿‡ç½‘ç»œåœ°å€è®¿é—®ä½ çš„æœåŠ¡
- **ä¿è¯ç¨³å®šè¿è¡Œ**ï¼š24å°æ—¶ä¸é—´æ–­æä¾›æœåŠ¡
- **æ–¹ä¾¿æ›´æ–°ç»´æŠ¤**ï¼šæ–°ç‰ˆæœ¬èƒ½å¿«é€Ÿæ›¿æ¢æ—§ç‰ˆæœ¬

### 1.2 ä¼ ç»Ÿéƒ¨ç½² vs è‡ªåŠ¨åŒ–éƒ¨ç½²


**ä¼ ç»Ÿæ‰‹å·¥éƒ¨ç½²çš„ç—›è‹¦**ï¼š
```
å¼€å‘å®Œæˆ â†’ æ‰“åŒ…åº”ç”¨ â†’ ç™»å½•æœåŠ¡å™¨ â†’ åœæ­¢æ—§æœåŠ¡ 
â†’ å¤‡ä»½æ—§ç‰ˆæœ¬ â†’ ä¸Šä¼ æ–°æ–‡ä»¶ â†’ ä¿®æ”¹é…ç½® â†’ å¯åŠ¨æ–°æœåŠ¡ 
â†’ æµ‹è¯•éªŒè¯ â†’ å‡ºé—®é¢˜æ‰‹å·¥å›æ»š...

é—®é¢˜ï¼š
ğŸ˜° æ­¥éª¤ç¹çï¼Œå®¹æ˜“å‡ºé”™
â° è€—æ—¶å¾ˆé•¿ï¼Œæ•ˆç‡ä½ä¸‹
ğŸ”„ é‡å¤åŠ³åŠ¨ï¼Œæ¯ç‡¥ä¹å‘³
ğŸ’¥ å‡ºé”™éš¾ä»¥å¿«é€Ÿæ¢å¤
```

**Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²çš„ä¼˜åŠ¿**ï¼š
```
ä»£ç æäº¤ â†’ Jenkinsè‡ªåŠ¨æ£€æµ‹ â†’ è‡ªåŠ¨æ„å»º â†’ è‡ªåŠ¨æµ‹è¯• 
â†’ è‡ªåŠ¨éƒ¨ç½² â†’ è‡ªåŠ¨éªŒè¯ â†’ éƒ¨ç½²æˆåŠŸâœ…

ä¼˜åŠ¿ï¼š
âš¡ ä¸€é”®éƒ¨ç½²ï¼Œå‡ åˆ†é’Ÿå®Œæˆ
ğŸ¯ æ ‡å‡†åŒ–æµç¨‹ï¼Œå‡å°‘é”™è¯¯
ğŸ”„ å¿«é€Ÿå›æ»šï¼Œé™ä½é£é™©
ğŸ“Š å…¨ç¨‹è®°å½•ï¼Œä¾¿äºè¿½è¸ª
```

### 1.3 éƒ¨ç½²æ¶æ„å›¾ç¤º


```
å¼€å‘ç¯å¢ƒ          JenkinsæœåŠ¡å™¨        ç”Ÿäº§æœåŠ¡å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¼€å‘ä»£ç  â”‚ â”€â”€1â”€â†’â”‚  æ‹‰å–ä»£ç    â”‚      â”‚  ç›®æ ‡æœåŠ¡å™¨  â”‚
â”‚ æœ¬åœ°æµ‹è¯• â”‚      â”‚  æ„å»ºæ‰“åŒ…   â”‚ â”€â”€3â”€â†’â”‚  åº”ç”¨è¿è¡Œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  æ‰§è¡Œéƒ¨ç½²   â”‚      â”‚  ç”¨æˆ·è®¿é—®   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                    â”€â”€â”€â”€2â”€â”€â”€â”€
                   è‡ªåŠ¨åŒ–è„šæœ¬
                   SSHè¿æ¥
                   æ–‡ä»¶ä¼ è¾“
```

---

## 2. ğŸ” SSHè¿œç¨‹éƒ¨ç½²é…ç½®


### 2.1 SSHå…å¯†ç™»å½•åŸç†


**ğŸ”¸ ä»€ä¹ˆæ˜¯SSHå…å¯†ç™»å½•**
```
å°±åƒç»™æœ‹å‹å®¶é—¨é’¥åŒ™ï¼Œä»¥åå»æœ‹å‹å®¶å°±ä¸ç”¨æ•²é—¨äº†ï¼š
- å¯†ç ç™»å½• = æ¯æ¬¡éƒ½è¦æ•²é—¨æŠ¥åå­—
- å…å¯†ç™»å½• = æœ‰é’¥åŒ™ç›´æ¥å¼€é—¨è¿›å»

æŠ€æœ¯åŸç†ï¼š
JenkinsæœåŠ¡å™¨ â†â”€â”€å¯†é’¥å¯¹â”€â”€â†’ ç›®æ ‡æœåŠ¡å™¨
å…¬é’¥å­˜æ”¾åœ¨ç›®æ ‡æœåŠ¡å™¨ï¼Œç§é’¥ä¿å­˜åœ¨Jenkins
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å…å¯†ç™»å½•**
- **å®‰å…¨æ€§**ï¼šé¿å…åœ¨è„šæœ¬ä¸­å†™æ˜æ–‡å¯†ç 
- **è‡ªåŠ¨åŒ–**ï¼šè„šæœ¬æ‰§è¡Œæ—¶æ— éœ€äººå·¥è¾“å…¥å¯†ç 
- **ç¨³å®šæ€§**ï¼šä¸ä¼šå› ä¸ºå¯†ç è¾“å…¥é”™è¯¯å¯¼è‡´éƒ¨ç½²å¤±è´¥

### 2.2 SSHå¯†é’¥é…ç½®æ­¥éª¤


**ğŸ”§ ç¬¬ä¸€æ­¥ï¼šåœ¨JenkinsæœåŠ¡å™¨ç”Ÿæˆå¯†é’¥å¯¹**
```bash
# åœ¨JenkinsæœåŠ¡å™¨ä¸Šæ‰§è¡Œ
ssh-keygen -t rsa -b 2048 -f ~/.ssh/jenkins_deploy

# è§£é‡Šï¼š
# -t rsaï¼šä½¿ç”¨RSAåŠ å¯†ç®—æ³•
# -b 2048ï¼šå¯†é’¥é•¿åº¦2048ä½ï¼ˆè¶³å¤Ÿå®‰å…¨ï¼‰
# -f ~/.ssh/jenkins_deployï¼šæŒ‡å®šå¯†é’¥æ–‡ä»¶å
```

**ğŸ”§ ç¬¬äºŒæ­¥ï¼šå°†å…¬é’¥å¤åˆ¶åˆ°ç›®æ ‡æœåŠ¡å™¨**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ssh-copy-idï¼ˆæ¨èï¼‰
ssh-copy-id -i ~/.ssh/jenkins_deploy.pub user@target-server

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å¤åˆ¶
cat ~/.ssh/jenkins_deploy.pub | ssh user@target-server "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

**ğŸ”§ ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•å…å¯†ç™»å½•**
```bash
# æµ‹è¯•è¿æ¥ï¼ˆåº”è¯¥æ— éœ€è¾“å…¥å¯†ç ï¼‰
ssh -i ~/.ssh/jenkins_deploy user@target-server

# æˆåŠŸæ ‡å¿—ï¼šç›´æ¥è¿›å…¥ç›®æ ‡æœåŠ¡å™¨å‘½ä»¤è¡Œ
```

### 2.3 Jenkinsä¸­é…ç½®SSHå‡­æ®


**ğŸ“‹ åœ¨Jenkinsç®¡ç†ç•Œé¢é…ç½®**
```
æ­¥éª¤1ï¼šè¿›å…¥ "Manage Jenkins" â†’ "Manage Credentials"
æ­¥éª¤2ï¼šé€‰æ‹©åˆé€‚çš„åŸŸï¼Œç‚¹å‡» "Add Credentials"
æ­¥éª¤3ï¼šé€‰æ‹©ç±»å‹ "SSH Username with private key"
æ­¥éª¤4ï¼šå¡«å†™é…ç½®ä¿¡æ¯ï¼š
       - ID: deploy-server-keyï¼ˆè‡ªå®šä¹‰æ ‡è¯†ï¼‰
       - Username: ç›®æ ‡æœåŠ¡å™¨ç”¨æˆ·å
       - Private Key: ç²˜è´´ç§é’¥å†…å®¹ï¼ˆjenkins_deployæ–‡ä»¶å†…å®¹ï¼‰
æ­¥éª¤5ï¼šä¿å­˜å‡­æ®
```

> ğŸ’¡ **å°è´´å£«**ï¼šå‡­æ®IDè¦èµ·ä¸ªæœ‰æ„ä¹‰çš„åå­—ï¼Œæ–¹ä¾¿åœ¨Pipelineä¸­å¼•ç”¨

### 2.4 å¸¸è§SSHé…ç½®é—®é¢˜


**ğŸ”¸ æƒé™é—®é¢˜è§£å†³**
```bash
# ç›®æ ‡æœåŠ¡å™¨ä¸Šæ£€æŸ¥æƒé™
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys

# ç¡®ä¿SSHæœåŠ¡é…ç½®æ­£ç¡®
sudo vim /etc/ssh/sshd_config
# ç¡®è®¤ä»¥ä¸‹é…ç½®ï¼š
# PubkeyAuthentication yes
# AuthorizedKeysFile .ssh/authorized_keys
```

**ğŸ”¸ è¿æ¥æµ‹è¯•è„šæœ¬**
```bash
#!/bin/bash
# æµ‹è¯•SSHè¿æ¥çš„ç®€å•è„šæœ¬

TARGET_SERVER="user@your-server-ip"
SSH_KEY="~/.ssh/jenkins_deploy"

echo "ğŸ”„ æµ‹è¯•SSHè¿æ¥åˆ° $TARGET_SERVER"
if ssh -i $SSH_KEY -o ConnectTimeout=10 $TARGET_SERVER "echo 'è¿æ¥æˆåŠŸï¼'"
then
    echo "âœ… SSHè¿æ¥æ­£å¸¸"
else
    echo "âŒ SSHè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®"
fi
```

---

## 3. ğŸ“ éƒ¨ç½²è„šæœ¬ç¼–å†™å®æˆ˜


### 3.1 éƒ¨ç½²è„šæœ¬çš„åŸºæœ¬ç»“æ„


**ğŸ”¸ ä¸€ä¸ªå®Œæ•´éƒ¨ç½²è„šæœ¬åŒ…å«ä»€ä¹ˆ**
```
éƒ¨ç½²è„šæœ¬ = æ¬å®¶å…¬å¸çš„æ ‡å‡†æµç¨‹

1. ğŸ  ç¯å¢ƒæ£€æŸ¥ï¼šç¡®è®¤ç›®æ ‡ç¯å¢ƒæ­£å¸¸
2. ğŸ“¦ å¤‡ä»½æ—§ç‰ˆï¼šä¿å­˜å½“å‰è¿è¡Œçš„ç‰ˆæœ¬
3. ğŸšš ä¼ è¾“æ–‡ä»¶ï¼šå°†æ–°ç‰ˆæœ¬æ–‡ä»¶ä¸Šä¼ 
4. âš™ï¸ æ›´æ–°é…ç½®ï¼šä¿®æ”¹å¿…è¦çš„é…ç½®æ–‡ä»¶
5. ğŸ”„ é‡å¯æœåŠ¡ï¼šåœæ­¢æ—§æœåŠ¡ï¼Œå¯åŠ¨æ–°æœåŠ¡
6. âœ… éªŒè¯éƒ¨ç½²ï¼šç¡®è®¤æ–°ç‰ˆæœ¬æ­£å¸¸è¿è¡Œ
7. ğŸ“ è®°å½•æ—¥å¿—ï¼šè®°å½•éƒ¨ç½²è¿‡ç¨‹å’Œç»“æœ
```

**ğŸ’¡ è„šæœ¬ç¼–å†™åŸåˆ™**
- **å¯è¯»æ€§å¼º**ï¼šæ·»åŠ æ³¨é‡Šï¼Œé€»è¾‘æ¸…æ™°
- **å®¹é”™æ€§å¥½**ï¼šæ£€æŸ¥æ¯æ­¥æ‰§è¡Œç»“æœ
- **å¯å›æ»š**ï¼šå‡ºé—®é¢˜èƒ½å¿«é€Ÿæ¢å¤
- **æ—¥å¿—è¯¦ç»†**ï¼šä¾¿äºé—®é¢˜æ’æŸ¥

### 3.2 Spring Bootåº”ç”¨éƒ¨ç½²è„šæœ¬ç¤ºä¾‹


```bash
#!/bin/bash
# Spring Bootåº”ç”¨è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
# ç”¨é€”ï¼šå°†jaråŒ…éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨

# ===================é…ç½®åŒºåŸŸ===================
APP_NAME="my-spring-app"
APP_PORT=8080
DEPLOY_DIR="/opt/apps/$APP_NAME"
BACKUP_DIR="/opt/backups/$APP_NAME"
JAR_NAME="$APP_NAME.jar"
LOG_FILE="/var/log/$APP_NAME/deploy.log"

# ===================å‡½æ•°å®šä¹‰===================
# æ—¥å¿—è®°å½•å‡½æ•°
log_info() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [INFO] $1" | tee -a $LOG_FILE
}

log_error() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [ERROR] $1" | tee -a $LOG_FILE
}

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_service() {
    if pgrep -f "$JAR_NAME" > /dev/null; then
        return 0  # æœåŠ¡æ­£åœ¨è¿è¡Œ
    else
        return 1  # æœåŠ¡æœªè¿è¡Œ
    fi
}

# ===================ä¸»è¦æµç¨‹===================
log_info "ğŸš€ å¼€å§‹éƒ¨ç½² $APP_NAME"

# æ­¥éª¤1ï¼šç¯å¢ƒæ£€æŸ¥
log_info "ğŸ“‹ æ­¥éª¤1ï¼šæ£€æŸ¥éƒ¨ç½²ç¯å¢ƒ"
if [[ ! -d "$DEPLOY_DIR" ]]; then
    log_info "åˆ›å»ºéƒ¨ç½²ç›®å½•ï¼š$DEPLOY_DIR"
    mkdir -p "$DEPLOY_DIR"
fi

if [[ ! -d "$BACKUP_DIR" ]]; then
    log_info "åˆ›å»ºå¤‡ä»½ç›®å½•ï¼š$BACKUP_DIR"
    mkdir -p "$BACKUP_DIR"
fi

# æ­¥éª¤2ï¼šå¤‡ä»½å½“å‰ç‰ˆæœ¬
if [[ -f "$DEPLOY_DIR/$JAR_NAME" ]]; then
    log_info "ğŸ’¾ æ­¥éª¤2ï¼šå¤‡ä»½å½“å‰ç‰ˆæœ¬"
    BACKUP_FILE="$BACKUP_DIR/${JAR_NAME}.$(date +%Y%m%d_%H%M%S).backup"
    cp "$DEPLOY_DIR/$JAR_NAME" "$BACKUP_FILE"
    log_info "å¤‡ä»½å®Œæˆï¼š$BACKUP_FILE"
fi

# æ­¥éª¤3ï¼šåœæ­¢å½“å‰æœåŠ¡
if check_service; then
    log_info "ğŸ›‘ æ­¥éª¤3ï¼šåœæ­¢å½“å‰æœåŠ¡"
    pkill -f "$JAR_NAME"
    
    # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢
    for i in {1..30}; do
        if ! check_service; then
            log_info "æœåŠ¡å·²åœæ­¢"
            break
        fi
        sleep 1
    done
    
    if check_service; then
        log_error "æœåŠ¡åœæ­¢è¶…æ—¶ï¼Œå¼ºåˆ¶ç»ˆæ­¢"
        pkill -9 -f "$JAR_NAME"
    fi
fi

# æ­¥éª¤4ï¼šéƒ¨ç½²æ–°ç‰ˆæœ¬
log_info "ğŸ“¦ æ­¥éª¤4ï¼šéƒ¨ç½²æ–°ç‰ˆæœ¬"
if [[ -f "$JAR_NAME" ]]; then
    cp "$JAR_NAME" "$DEPLOY_DIR/"
    chmod +x "$DEPLOY_DIR/$JAR_NAME"
    log_info "æ–°ç‰ˆæœ¬éƒ¨ç½²å®Œæˆ"
else
    log_error "æ‰¾ä¸åˆ°jaræ–‡ä»¶ï¼š$JAR_NAME"
    exit 1
fi

# æ­¥éª¤5ï¼šå¯åŠ¨æ–°æœåŠ¡
log_info "â–¶ï¸ æ­¥éª¤5ï¼šå¯åŠ¨æ–°æœåŠ¡"
cd "$DEPLOY_DIR"
nohup java -jar -Xms512m -Xmx1024m "$JAR_NAME" > /dev/null 2>&1 &

# æ­¥éª¤6ï¼šéªŒè¯éƒ¨ç½²
log_info "âœ… æ­¥éª¤6ï¼šéªŒè¯éƒ¨ç½²ç»“æœ"
sleep 10  # ç­‰å¾…åº”ç”¨å¯åŠ¨

for i in {1..30}; do
    if curl -f "http://localhost:$APP_PORT/health" > /dev/null 2>&1; then
        log_info "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼åº”ç”¨æ­£å¸¸è¿è¡Œ"
        exit 0
    fi
    sleep 2
done

log_error "âŒ éƒ¨ç½²å¤±è´¥ï¼åº”ç”¨å¯åŠ¨å¼‚å¸¸"
exit 1
```

### 3.3 Node.jsåº”ç”¨éƒ¨ç½²è„šæœ¬


```bash
#!/bin/bash
# Node.jsåº”ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆä½¿ç”¨PM2ç®¡ç†ï¼‰

APP_NAME="my-node-app"
DEPLOY_DIR="/opt/apps/$APP_NAME"
NODE_ENV="production"

log_info() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1"
}

log_info "ğŸš€ å¼€å§‹éƒ¨ç½²Node.jsåº”ç”¨"

# è¿›å…¥éƒ¨ç½²ç›®å½•
cd "$DEPLOY_DIR" || exit 1

# å®‰è£…ä¾èµ–
log_info "ğŸ“¦ å®‰è£…ä¾èµ–åŒ…"
npm install --production

# ä½¿ç”¨PM2é‡å¯åº”ç”¨
log_info "ğŸ”„ é‡å¯åº”ç”¨æœåŠ¡"
if pm2 describe "$APP_NAME" > /dev/null 2>&1; then
    pm2 restart "$APP_NAME"
else
    pm2 start app.js --name "$APP_NAME" --env "$NODE_ENV"
fi

# éªŒè¯åº”ç”¨çŠ¶æ€
sleep 5
if pm2 describe "$APP_NAME" | grep "online" > /dev/null; then
    log_info "âœ… Node.jsåº”ç”¨éƒ¨ç½²æˆåŠŸ"
else
    log_info "âŒ Node.jsåº”ç”¨éƒ¨ç½²å¤±è´¥"
    exit 1
fi
```

---

## 4. âš™ï¸ æœåŠ¡å¯åœä¸ç®¡ç†


### 4.1 æœåŠ¡å¯åœçš„å¸¸ç”¨æ–¹æ³•


**ğŸ”¸ Javaåº”ç”¨ï¼ˆSpring Bootï¼‰**
```bash
# å¯åŠ¨æ–¹å¼1ï¼šç›´æ¥å¯åŠ¨ï¼ˆç®€å•ï¼‰
java -jar app.jar

# å¯åŠ¨æ–¹å¼2ï¼šåå°è¿è¡Œï¼ˆæ¨èï¼‰
nohup java -jar -Xms512m -Xmx1024m app.jar > app.log 2>&1 &

# å¯åŠ¨æ–¹å¼3ï¼šä½¿ç”¨systemdï¼ˆç”Ÿäº§æ¨èï¼‰
# åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š/etc/systemd/system/myapp.service
sudo systemctl start myapp
sudo systemctl enable myapp  # å¼€æœºè‡ªå¯

# åœæ­¢æœåŠ¡
pkill -f "app.jar"           # æ ¹æ®jarååœæ­¢
kill -9 PID                  # æ ¹æ®è¿›ç¨‹IDå¼ºåˆ¶åœæ­¢
sudo systemctl stop myapp    # systemdæ–¹å¼åœæ­¢
```

**ğŸ”¸ Node.jsåº”ç”¨**
```bash
# ä½¿ç”¨PM2ç®¡ç†ï¼ˆæ¨èï¼‰
pm2 start app.js --name myapp    # å¯åŠ¨
pm2 restart myapp                # é‡å¯
pm2 stop myapp                   # åœæ­¢
pm2 delete myapp                 # åˆ é™¤

# ç›´æ¥å¯åŠ¨
node app.js                      # å‰å°è¿è¡Œ
nohup node app.js > app.log &    # åå°è¿è¡Œ

# åœæ­¢
pm2 stop myapp                   # PM2æ–¹å¼
pkill -f "node.*app.js"         # ç›´æ¥æ€è¿›ç¨‹
```

**ğŸ”¸ WebæœåŠ¡å™¨ï¼ˆNginx/Apacheï¼‰**
```bash
# Nginx
sudo systemctl start nginx      # å¯åŠ¨
sudo systemctl stop nginx       # åœæ­¢
sudo systemctl reload nginx     # é‡æ–°åŠ è½½é…ç½®
sudo nginx -t                   # æ£€æŸ¥é…ç½®è¯­æ³•

# Apache
sudo systemctl start apache2    # å¯åŠ¨
sudo systemctl stop apache2     # åœæ­¢
sudo systemctl reload apache2   # é‡æ–°åŠ è½½
```

### 4.2 å¥åº·æ£€æŸ¥ä¸çŠ¶æ€ç›‘æ§


**ğŸ”¸ åº”ç”¨å¥åº·æ£€æŸ¥æ–¹æ³•**
```bash
# HTTPå¥åº·æ£€æŸ¥
check_health() {
    local url="$1"
    local max_attempts=30
    
    for i in $(seq 1 $max_attempts); do
        if curl -f "$url" > /dev/null 2>&1; then
            echo "âœ… åº”ç”¨å¥åº·æ£€æŸ¥é€šè¿‡"
            return 0
        fi
        echo "â³ ç¬¬${i}æ¬¡æ£€æŸ¥ï¼Œç­‰å¾…åº”ç”¨å¯åŠ¨..."
        sleep 2
    done
    
    echo "âŒ åº”ç”¨å¥åº·æ£€æŸ¥å¤±è´¥"
    return 1
}

# ä½¿ç”¨ç¤ºä¾‹
check_health "http://localhost:8080/health"
```

**ğŸ”¸ è¿›ç¨‹çŠ¶æ€æ£€æŸ¥**
```bash
# æ£€æŸ¥Javaåº”ç”¨æ˜¯å¦è¿è¡Œ
check_java_app() {
    local jar_name="$1"
    if pgrep -f "$jar_name" > /dev/null; then
        echo "âœ… $jar_name æ­£åœ¨è¿è¡Œ"
        return 0
    else
        echo "âŒ $jar_name æœªè¿è¡Œ"
        return 1
    fi
}

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
check_port() {
    local port="$1"
    if netstat -tlnp | grep ":$port " > /dev/null; then
        echo "âœ… ç«¯å£ $port æ­£åœ¨ä½¿ç”¨"
        return 0
    else
        echo "âŒ ç«¯å£ $port æœªè¢«å ç”¨"
        return 1
    fi
}
```

### 4.3 ä¼˜é›…åœæ­¢ä¸å¯åŠ¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä¼˜é›…åœæ­¢**
```
ä¼˜é›…åœæ­¢ = ç¤¼è²Œåœ°å…³é—¨

æš´åŠ›åœæ­¢ï¼škill -9ï¼ˆç›´æ¥æ–­ç”µï¼‰
- å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
- æ­£åœ¨å¤„ç†çš„è¯·æ±‚è¢«ä¸­æ–­
- ä¸´æ—¶æ–‡ä»¶æ²¡æœ‰æ¸…ç†

ä¼˜é›…åœæ­¢ï¼šå‘é€SIGTERMä¿¡å·
- åº”ç”¨æ”¶åˆ°ä¿¡å·åå®Œæˆå½“å‰è¯·æ±‚
- ä¿å­˜å¿…è¦çš„æ•°æ®
- æ¸…ç†ä¸´æ—¶èµ„æº
- ç„¶åæ‰é€€å‡º
```

**ğŸ”¸ ä¼˜é›…åœæ­¢å®ç°**
```bash
# Javaåº”ç”¨ä¼˜é›…åœæ­¢
graceful_stop_java() {
    local jar_name="$1"
    local timeout=30
    
    # è·å–è¿›ç¨‹ID
    local pid=$(pgrep -f "$jar_name")
    if [[ -z "$pid" ]]; then
        echo "åº”ç”¨æœªè¿è¡Œ"
        return 0
    fi
    
    echo "å‘é€SIGTERMä¿¡å·åˆ°è¿›ç¨‹ $pid"
    kill -TERM "$pid"
    
    # ç­‰å¾…è¿›ç¨‹è‡ªç„¶é€€å‡º
    for i in $(seq 1 $timeout); do
        if ! kill -0 "$pid" 2>/dev/null; then
            echo "âœ… åº”ç”¨å·²ä¼˜é›…åœæ­¢"
            return 0
        fi
        sleep 1
    done
    
    # è¶…æ—¶åˆ™å¼ºåˆ¶ç»ˆæ­¢
    echo "âš ï¸ ä¼˜é›…åœæ­¢è¶…æ—¶ï¼Œå¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹"
    kill -9 "$pid"
}
```

---

## 5. ğŸ“ é…ç½®æ–‡ä»¶ç®¡ç†ç­–ç•¥


### 5.1 é…ç½®æ–‡ä»¶ç®¡ç†çš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆé…ç½®æ–‡ä»¶å¾ˆé‡è¦**
```
é…ç½®æ–‡ä»¶ = åº”ç”¨çš„"è¯´æ˜ä¹¦"

åŒ…å«å†…å®¹ï¼š
- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- æœåŠ¡å™¨ç«¯å£è®¾ç½®
- æ—¥å¿—çº§åˆ«é…ç½®
- ç¬¬ä¸‰æ–¹æœåŠ¡åœ°å€
- å®‰å…¨å¯†é’¥ä¿¡æ¯

ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒé…ç½®ï¼š
å¼€å‘ç¯å¢ƒï¼šè¿æ¥æµ‹è¯•æ•°æ®åº“ï¼Œè¯¦ç»†æ—¥å¿—
æµ‹è¯•ç¯å¢ƒï¼šè¿æ¥æµ‹è¯•æ•°æ®åº“ï¼Œæ¨¡æ‹Ÿç”Ÿäº§é…ç½®
ç”Ÿäº§ç¯å¢ƒï¼šè¿æ¥ç”Ÿäº§æ•°æ®åº“ï¼Œç²¾ç®€æ—¥å¿—
```

**ğŸ’¡ é…ç½®ç®¡ç†é¢ä¸´çš„é—®é¢˜**
- **ç¯å¢ƒå·®å¼‚**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®ä¸åŒ
- **å®‰å…¨æ€§**ï¼šæ•æ„Ÿä¿¡æ¯ä¸èƒ½ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
- **ç»´æŠ¤æ€§**ï¼šé…ç½®å˜æ›´ä¸åº”è¯¥é‡æ–°ç¼–è¯‘ä»£ç 
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šé…ç½®å˜æ›´éœ€è¦æœ‰è®°å½•å’Œå›æ»šèƒ½åŠ›

### 5.2 é…ç½®æ–‡ä»¶åˆ†ç¦»ç­–ç•¥


**ğŸ”¸ æ–¹æ¡ˆ1ï¼šç¯å¢ƒå˜é‡æ–¹å¼**
```bash
# åœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®ç¯å¢ƒå˜é‡
export DB_HOST="192.168.1.100"
export DB_PORT="3306"
export DB_USERNAME="app_user"
export DB_PASSWORD="secure_password"
export APP_ENV="production"

# Javaåº”ç”¨è¯»å–ç¯å¢ƒå˜é‡
# application.properties
spring.datasource.url=jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/mydb
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:password}
```

**ğŸ”¸ æ–¹æ¡ˆ2ï¼šé…ç½®æ–‡ä»¶å¤–ç½®**
```
é¡¹ç›®ç»“æ„ï¼š
myapp/
â”œâ”€â”€ myapp.jar                    # åº”ç”¨ç¨‹åº
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ application.properties   # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ application-dev.properties    # å¼€å‘ç¯å¢ƒ
â”‚   â”œâ”€â”€ application-test.properties   # æµ‹è¯•ç¯å¢ƒ
â”‚   â””â”€â”€ application-prod.properties   # ç”Ÿäº§ç¯å¢ƒ
â””â”€â”€ scripts/
    â””â”€â”€ start.sh                 # å¯åŠ¨è„šæœ¬
```

**ğŸ”¸ å¯åŠ¨è„šæœ¬æŒ‡å®šé…ç½®**
```bash
#!/bin/bash
# æ ¹æ®ç¯å¢ƒå¯åŠ¨åº”ç”¨

ENVIRONMENT=${1:-prod}  # é»˜è®¤ç”Ÿäº§ç¯å¢ƒ
CONFIG_DIR="/opt/myapp/config"

echo "ğŸš€ å¯åŠ¨åº”ç”¨ï¼Œç¯å¢ƒï¼š$ENVIRONMENT"

java -jar \
  -Dspring.profiles.active=$ENVIRONMENT \
  -Dspring.config.location=$CONFIG_DIR/ \
  myapp.jar
```

### 5.3 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤


**ğŸ”¸ æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä¸“é—¨çš„é…ç½®æœåŠ¡**
```bash
# ä½¿ç”¨Consul/Vaultç­‰é…ç½®ä¸­å¿ƒ
# åº”ç”¨å¯åŠ¨æ—¶ä»é…ç½®ä¸­å¿ƒè·å–æ•æ„Ÿä¿¡æ¯

# Jenkinsä¸­è®¾ç½®ç¯å¢ƒå˜é‡
export VAULT_TOKEN="your-vault-token"
export CONFIG_SERVER_URL="http://consul:8500"

# åº”ç”¨å¯åŠ¨æ—¶è¯»å–é…ç½®
java -jar \
  -Dvault.token=$VAULT_TOKEN \
  -Dconfig.server.url=$CONFIG_SERVER_URL \
  myapp.jar
```

**ğŸ”¸ æ–¹æ¡ˆ2ï¼šJenkinså‡­æ®ç®¡ç†**
```groovy
// Jenkins Pipelineä¸­ä½¿ç”¨å‡­æ®
pipeline {
    agent any
    
    environment {
        DB_PASSWORD = credentials('database-password')
        API_KEY = credentials('third-party-api-key')
    }
    
    stages {
        stage('Deploy') {
            steps {
                script {
                    // é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’æ•æ„Ÿä¿¡æ¯
                    sh """
                        export DB_PASSWORD='${DB_PASSWORD}'
                        export API_KEY='${API_KEY}'
                        ./deploy.sh
                    """
                }
            }
        }
    }
}
```

### 5.4 é…ç½®æ›´æ–°ä¸éªŒè¯


**ğŸ”¸ é…ç½®æ›´æ–°æµç¨‹**
```bash
#!/bin/bash
# é…ç½®æ–‡ä»¶æ›´æ–°è„šæœ¬

CONFIG_FILE="application-prod.properties"
BACKUP_DIR="/opt/backups/config"
CONFIG_DIR="/opt/myapp/config"

# 1. å¤‡ä»½å½“å‰é…ç½®
backup_config() {
    local timestamp=$(date +%Y%m%d_%H%M%S)
    local backup_file="$BACKUP_DIR/${CONFIG_FILE}.${timestamp}.backup"
    
    if [[ -f "$CONFIG_DIR/$CONFIG_FILE" ]]; then
        cp "$CONFIG_DIR/$CONFIG_FILE" "$backup_file"
        echo "âœ… é…ç½®å·²å¤‡ä»½åˆ°ï¼š$backup_file"
    fi
}

# 2. éªŒè¯é…ç½®æ ¼å¼
validate_config() {
    local new_config="$1"
    
    # æ£€æŸ¥å¿…éœ€çš„é…ç½®é¡¹
    local required_keys=("server.port" "spring.datasource.url" "logging.level.root")
    
    for key in "${required_keys[@]}"; do
        if ! grep -q "^$key=" "$new_config"; then
            echo "âŒ ç¼ºå°‘å¿…éœ€é…ç½®ï¼š$key"
            return 1
        fi
    done
    
    echo "âœ… é…ç½®æ ¼å¼éªŒè¯é€šè¿‡"
    return 0
}

# 3. åº”ç”¨æ–°é…ç½®
apply_config() {
    local new_config="$1"
    
    backup_config
    
    if validate_config "$new_config"; then
        cp "$new_config" "$CONFIG_DIR/$CONFIG_FILE"
        echo "âœ… é…ç½®æ›´æ–°æˆåŠŸ"
        return 0
    else
        echo "âŒ é…ç½®éªŒè¯å¤±è´¥ï¼Œæ›´æ–°ä¸­æ­¢"
        return 1
    fi
}
```

---

## 6. âœ… éƒ¨ç½²éªŒè¯ä¸å›æ»š


### 6.1 éƒ¨ç½²éªŒè¯ç­–ç•¥


**ğŸ”¸ å¤šå±‚æ¬¡éªŒè¯æ–¹æ¡ˆ**
```
éªŒè¯å±‚æ¬¡ä»ç®€å•åˆ°å¤æ‚ï¼š

Level 1: è¿›ç¨‹æ£€æŸ¥
â””â”€ åº”ç”¨è¿›ç¨‹æ˜¯å¦æ­£å¸¸å¯åŠ¨

Level 2: ç«¯å£æ£€æŸ¥  
â””â”€ åº”ç”¨ç«¯å£æ˜¯å¦æ­£å¸¸ç›‘å¬

Level 3: å¥åº·æ£€æŸ¥
â””â”€ HTTPå¥åº·æ£€æŸ¥æ¥å£å“åº”

Level 4: åŠŸèƒ½éªŒè¯
â””â”€ å…³é”®ä¸šåŠ¡åŠŸèƒ½æ˜¯å¦æ­£å¸¸

Level 5: æ€§èƒ½éªŒè¯
â””â”€ å“åº”æ—¶é—´æ˜¯å¦åœ¨é¢„æœŸèŒƒå›´
```

**ğŸ’¡ éªŒè¯è„šæœ¬å®ç°**
```bash
#!/bin/bash
# å®Œæ•´çš„éƒ¨ç½²éªŒè¯è„šæœ¬

APP_NAME="my-spring-app"
APP_PORT=8080
HEALTH_URL="http://localhost:$APP_PORT/actuator/health"
API_URL="http://localhost:$APP_PORT/api/test"

# Level 1: è¿›ç¨‹æ£€æŸ¥
verify_process() {
    echo "ğŸ” Level 1: æ£€æŸ¥åº”ç”¨è¿›ç¨‹"
    if pgrep -f "$APP_NAME" > /dev/null; then
        echo "âœ… åº”ç”¨è¿›ç¨‹æ­£å¸¸è¿è¡Œ"
        return 0
    else
        echo "âŒ åº”ç”¨è¿›ç¨‹æœªæ‰¾åˆ°"
        return 1
    fi
}

# Level 2: ç«¯å£æ£€æŸ¥
verify_port() {
    echo "ğŸ” Level 2: æ£€æŸ¥ç«¯å£ç›‘å¬"
    if netstat -tlnp | grep ":$APP_PORT " > /dev/null; then
        echo "âœ… ç«¯å£ $APP_PORT æ­£å¸¸ç›‘å¬"
        return 0
    else
        echo "âŒ ç«¯å£ $APP_PORT æœªç›‘å¬"
        return 1
    fi
}

# Level 3: å¥åº·æ£€æŸ¥
verify_health() {
    echo "ğŸ” Level 3: å¥åº·æ£€æŸ¥"
    local max_attempts=30
    
    for i in $(seq 1 $max_attempts); do
        if curl -f "$HEALTH_URL" > /dev/null 2>&1; then
            echo "âœ… å¥åº·æ£€æŸ¥é€šè¿‡"
            return 0
        fi
        echo "â³ ç¬¬${i}æ¬¡æ£€æŸ¥ï¼Œç­‰å¾…åº”ç”¨å°±ç»ª..."
        sleep 2
    done
    
    echo "âŒ å¥åº·æ£€æŸ¥å¤±è´¥"
    return 1
}

# Level 4: åŠŸèƒ½éªŒè¯
verify_function() {
    echo "ğŸ” Level 4: åŠŸèƒ½éªŒè¯"
    
    # æµ‹è¯•APIæ¥å£
    local response=$(curl -s "$API_URL")
    if [[ "$response" == *"success"* ]]; then
        echo "âœ… APIåŠŸèƒ½éªŒè¯é€šè¿‡"
        return 0
    else
        echo "âŒ APIåŠŸèƒ½éªŒè¯å¤±è´¥ï¼š$response"
        return 1
    fi
}

# æ‰§è¡Œå®Œæ•´éªŒè¯
run_verification() {
    echo "ğŸš€ å¼€å§‹éƒ¨ç½²éªŒè¯"
    
    local checks=(verify_process verify_port verify_health verify_function)
    
    for check in "${checks[@]}"; do
        if ! $check; then
            echo "ğŸ’¥ éªŒè¯å¤±è´¥ï¼Œéœ€è¦å›æ»š"
            return 1
        fi
    done
    
    echo "ğŸ‰ æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Œéƒ¨ç½²æˆåŠŸï¼"
    return 0
}
```

### 6.2 å›æ»šæœºåˆ¶å®ç°


**ğŸ”¸ ä»€ä¹ˆæ—¶å€™éœ€è¦å›æ»š**
```
å›æ»šè§¦å‘æ¡ä»¶ï¼š
- âŒ åº”ç”¨å¯åŠ¨å¤±è´¥
- âŒ å¥åº·æ£€æŸ¥ä¸é€šè¿‡  
- âŒ å…³é”®åŠŸèƒ½å¼‚å¸¸
- âŒ æ€§èƒ½æ˜¾è‘—ä¸‹é™
- âŒ ç”¨æˆ·æŠ•è¯‰æ¿€å¢
```

**ğŸ”¸ è‡ªåŠ¨å›æ»šè„šæœ¬**
```bash
#!/bin/bash
# è‡ªåŠ¨å›æ»šè„šæœ¬

APP_NAME="my-spring-app"
DEPLOY_DIR="/opt/apps/$APP_NAME"
BACKUP_DIR="/opt/backups/$APP_NAME"
JAR_NAME="$APP_NAME.jar"

# æŸ¥æ‰¾æœ€æ–°çš„å¤‡ä»½æ–‡ä»¶
find_latest_backup() {
    local latest_backup=$(ls -t "$BACKUP_DIR"/*.backup 2>/dev/null | head -1)
    if [[ -n "$latest_backup" ]]; then
        echo "$latest_backup"
        return 0
    else
        echo "âŒ æœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶"
        return 1
    fi
}

# æ‰§è¡Œå›æ»š
perform_rollback() {
    echo "ğŸ”„ å¼€å§‹è‡ªåŠ¨å›æ»š"
    
    # 1. åœæ­¢å½“å‰æœåŠ¡
    echo "ğŸ›‘ åœæ­¢å½“å‰æœåŠ¡"
    pkill -f "$JAR_NAME"
    sleep 5
    
    # 2. æ¢å¤å¤‡ä»½æ–‡ä»¶
    local backup_file=$(find_latest_backup)
    if [[ $? -eq 0 ]]; then
        echo "ğŸ“¦ æ¢å¤å¤‡ä»½ï¼š$backup_file"
        cp "$backup_file" "$DEPLOY_DIR/$JAR_NAME"
    else
        echo "âŒ å›æ»šå¤±è´¥ï¼šæ— å¤‡ä»½æ–‡ä»¶"
        return 1
    fi
    
    # 3. å¯åŠ¨æ—§ç‰ˆæœ¬
    echo "â–¶ï¸ å¯åŠ¨æ—§ç‰ˆæœ¬"
    cd "$DEPLOY_DIR"
    nohup java -jar "$JAR_NAME" > /dev/null 2>&1 &
    
    # 4. éªŒè¯å›æ»šç»“æœ
    sleep 10
    if curl -f "http://localhost:8080/health" > /dev/null 2>&1; then
        echo "âœ… å›æ»šæˆåŠŸï¼Œæ—§ç‰ˆæœ¬æ­£å¸¸è¿è¡Œ"
        return 0
    else
        echo "âŒ å›æ»šå¤±è´¥ï¼ŒæœåŠ¡ä»ç„¶å¼‚å¸¸"
        return 1
    fi
}

# å¸¦éªŒè¯çš„éƒ¨ç½²å‡½æ•°
deploy_with_rollback() {
    echo "ğŸš€ å¼€å§‹å¸¦å›æ»šä¿æŠ¤çš„éƒ¨ç½²"
    
    # æ‰§è¡Œéƒ¨ç½²ï¼ˆè¿™é‡Œè°ƒç”¨å®é™…çš„éƒ¨ç½²è„šæœ¬ï¼‰
    if ./deploy.sh; then
        echo "ğŸ“‹ éƒ¨ç½²å®Œæˆï¼Œå¼€å§‹éªŒè¯"
        
        # æ‰§è¡ŒéªŒè¯
        if run_verification; then
            echo "ğŸ‰ éƒ¨ç½²éªŒè¯æˆåŠŸ"
            return 0
        else
            echo "âš ï¸ éƒ¨ç½²éªŒè¯å¤±è´¥ï¼Œå¼€å§‹è‡ªåŠ¨å›æ»š"
            perform_rollback
            return 1
        fi
    else
        echo "âŒ éƒ¨ç½²è¿‡ç¨‹å¤±è´¥"
        return 1
    fi
}
```

### 6.3 Jenkinsä¸­çš„å›æ»šé…ç½®


**ğŸ”¸ Jenkins Pipelineå›æ»šç¤ºä¾‹**
```groovy
pipeline {
    agent any
    
    stages {
        stage('Deploy') {
            steps {
                script {
                    try {
                        // æ‰§è¡Œéƒ¨ç½²
                        sh './deploy.sh'
                        
                        // éªŒè¯éƒ¨ç½²
                        sh './verify.sh'
                        
                        echo "âœ… éƒ¨ç½²æˆåŠŸ"
                    } catch (Exception e) {
                        echo "âŒ éƒ¨ç½²æˆ–éªŒè¯å¤±è´¥ï¼š${e.getMessage()}"
                        
                        // è‡ªåŠ¨å›æ»š
                        sh './rollback.sh'
                        
                        // é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œæ ‡è®°æ„å»ºå¤±è´¥
                        throw e
                    }
                }
            }
        }
    }
    
    post {
        failure {
            // å‘é€å¤±è´¥é€šçŸ¥
            emailext(
                subject: "éƒ¨ç½²å¤±è´¥å¹¶å·²å›æ»šï¼š${env.JOB_NAME}",
                body: "æ„å»º ${env.BUILD_NUMBER} éƒ¨ç½²å¤±è´¥ï¼Œç³»ç»Ÿå·²è‡ªåŠ¨å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬",
                to: "dev-team@company.com"
            )
        }
    }
}
```

---

## 7. ğŸ“Š éƒ¨ç½²æ—¥å¿—ä¸ç›‘æ§


### 7.1 éƒ¨ç½²æ—¥å¿—è®°å½•


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦è¯¦ç»†çš„éƒ¨ç½²æ—¥å¿—**
```
éƒ¨ç½²æ—¥å¿—çš„ä½œç”¨ï¼š
ğŸ” é—®é¢˜æ’æŸ¥ï¼šå‡ºé”™æ—¶èƒ½å¿«é€Ÿå®šä½åŸå› 
ğŸ“ˆ æ€§èƒ½åˆ†æï¼šäº†è§£æ¯ä¸ªæ­¥éª¤çš„è€—æ—¶
ğŸ“‹ æ“ä½œå®¡è®¡ï¼šè®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™åšäº†ä»€ä¹ˆ
ğŸ”„ æµç¨‹ä¼˜åŒ–ï¼šåˆ†æéƒ¨ç½²è¿‡ç¨‹ä¸­çš„ç“¶é¢ˆ
```

**ğŸ’¡ æ—¥å¿—è®°å½•æœ€ä½³å®è·µ**
```bash
#!/bin/bash
# æ—¥å¿—è®°å½•ç¤ºä¾‹è„šæœ¬

# æ—¥å¿—é…ç½®
LOG_DIR="/var/log/deployment"
LOG_FILE="$LOG_DIR/deploy-$(date +%Y%m%d).log"
ERROR_LOG="$LOG_DIR/deploy-error-$(date +%Y%m%d).log"

# ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨
mkdir -p "$LOG_DIR"

# æ—¥å¿—å‡½æ•°
log_info() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local message="[$timestamp] [INFO] $1"
    echo "$message" | tee -a "$LOG_FILE"
}

log_error() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local message="[$timestamp] [ERROR] $1"
    echo "$message" | tee -a "$LOG_FILE" | tee -a "$ERROR_LOG"
}

log_step() {
    local step_name="$1"
    local start_time=$(date +%s)
    
    log_info "ğŸš€ å¼€å§‹æ­¥éª¤ï¼š$step_name"
    
    # æ‰§è¡Œæ­¥éª¤ï¼ˆè¿™é‡Œæ˜¯ç¤ºä¾‹ï¼‰
    if eval "$2"; then
        local end_time=$(date +%s)
        local duration=$((end_time - start_time))
        log_info "âœ… æ­¥éª¤å®Œæˆï¼š$step_name (è€—æ—¶: ${duration}ç§’)"
        return 0
    else
        log_error "âŒ æ­¥éª¤å¤±è´¥ï¼š$step_name"
        return 1
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
log_step "åœæ­¢æ—§æœåŠ¡" "pkill -f myapp.jar"
log_step "éƒ¨ç½²æ–°ç‰ˆæœ¬" "cp new-app.jar /opt/apps/"
log_step "å¯åŠ¨æ–°æœåŠ¡" "cd /opt/apps && nohup java -jar myapp.jar &"
```

### 7.2 ç»“æ„åŒ–æ—¥å¿—è¾“å‡º


**ğŸ”¸ JSONæ ¼å¼æ—¥å¿—**
```bash
# JSONæ ¼å¼æ—¥å¿—å‡½æ•°
log_json() {
    local level="$1"
    local message="$2"
    local step="$3"
    local duration="$4"
    
    local timestamp=$(date -u +"%Y-%m-%dT%H:%M:%S.%3NZ")
    
    local json_log=$(cat << EOF
{
    "timestamp": "$timestamp",
    "level": "$level",
    "message": "$message",
    "step": "$step",
    "duration": $duration,
    "host": "$(hostname)",
    "user": "$(whoami)",
    "build_number": "${BUILD_NUMBER:-unknown}"
}
EOF
    )
    
    echo "$json_log" >> "$LOG_FILE"
}

# ä½¿ç”¨ç¤ºä¾‹
log_json "INFO" "å¼€å§‹éƒ¨ç½²åº”ç”¨" "deploy_start" 0
log_json "ERROR" "å¥åº·æ£€æŸ¥å¤±è´¥" "health_check" 30
```

### 7.3 ç›‘æ§æŒ‡æ ‡æ”¶é›†


**ğŸ”¸ å…³é”®ç›‘æ§æŒ‡æ ‡**
```bash
#!/bin/bash
# éƒ¨ç½²ç›‘æ§æŒ‡æ ‡æ”¶é›†

# æ€§èƒ½æŒ‡æ ‡æ”¶é›†
collect_metrics() {
    local app_name="$1"
    local metrics_file="/tmp/deploy_metrics.json"
    
    # éƒ¨ç½²è€—æ—¶
    local deploy_duration="$2"
    
    # åº”ç”¨å¯åŠ¨æ—¶é—´
    local startup_time=$(curl -s "http://localhost:8080/actuator/metrics/process.uptime" | jq '.measurements[0].value')
    
    # å†…å­˜ä½¿ç”¨
    local memory_used=$(curl -s "http://localhost:8080/actuator/metrics/jvm.memory.used" | jq '.measurements[0].value')
    
    # CPUä½¿ç”¨ç‡
    local cpu_usage=$(curl -s "http://localhost:8080/actuator/metrics/process.cpu.usage" | jq '.measurements[0].value')
    
    # ç”ŸæˆæŒ‡æ ‡æŠ¥å‘Š
    cat > "$metrics_file" << EOF
{
    "app_name": "$app_name",
    "deploy_time": "$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)",
    "deploy_duration": $deploy_duration,
    "startup_time": $startup_time,
    "memory_used": $memory_used,
    "cpu_usage": $cpu_usage,
    "build_number": "${BUILD_NUMBER:-unknown}"
}
EOF
    
    echo "ğŸ“Š ç›‘æ§æŒ‡æ ‡å·²æ”¶é›†åˆ°ï¼š$metrics_file"
}
```

### 7.4 å‘Šè­¦ä¸é€šçŸ¥


**ğŸ”¸ éƒ¨ç½²çŠ¶æ€é€šçŸ¥**
```bash
# é’‰é’‰é€šçŸ¥å‡½æ•°
send_dingtalk_notification() {
    local webhook_url="$1"
    local title="$2"
    local message="$3"
    local is_success="$4"
    
    local color="green"
    if [[ "$is_success" != "true" ]]; then
        color="red"
    fi
    
    local payload=$(cat << EOF
{
    "msgtype": "markdown",
    "markdown": {
        "title": "$title",
        "text": "## $title\n\n**æ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')\n\n**æ¶ˆæ¯**: $message\n\n**æ„å»ºå·**: ${BUILD_NUMBER:-unknown}\n\n**æœåŠ¡å™¨**: $(hostname)"
    }
}
EOF
    )
    
    curl -X POST "$webhook_url" \
        -H "Content-Type: application/json" \
        -d "$payload"
}

# é‚®ä»¶é€šçŸ¥å‡½æ•°  
send_email_notification() {
    local recipient="$1"
    local subject="$2"
    local body="$3"
    
    # ä½¿ç”¨ç³»ç»Ÿé‚®ä»¶å‘½ä»¤
    echo "$body" | mail -s "$subject" "$recipient"
}

# ç»¼åˆé€šçŸ¥å‡½æ•°
notify_deployment_result() {
    local result="$1"  # success æˆ– failure
    local app_name="$2"
    local details="$3"
    
    if [[ "$result" == "success" ]]; then
        local title="âœ… éƒ¨ç½²æˆåŠŸï¼š$app_name"
        local message="åº”ç”¨ $app_name å·²æˆåŠŸéƒ¨ç½²å¹¶é€šè¿‡éªŒè¯"
        send_dingtalk_notification "$DINGTALK_WEBHOOK" "$title" "$message" "true"
    else
        local title="âŒ éƒ¨ç½²å¤±è´¥ï¼š$app_name"
        local message="åº”ç”¨ $app_name éƒ¨ç½²å¤±è´¥ï¼Œè¯¦æƒ…ï¼š$details"
        send_dingtalk_notification "$DINGTALK_WEBHOOK" "$title" "$message" "false"
        send_email_notification "ops-team@company.com" "$title" "$message"
    fi
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åº”ç”¨éƒ¨ç½²æœ¬è´¨ï¼šå°†å¼€å‘å®Œæˆçš„ç¨‹åºå®‰å…¨ç¨³å®šåœ°"æ¬"åˆ°æœåŠ¡å™¨è¿è¡Œ
ğŸ”¸ SSHå…å¯†ç™»å½•ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²çš„åŸºç¡€ï¼Œé¿å…è„šæœ¬ä¸­ä½¿ç”¨æ˜æ–‡å¯†ç 
ğŸ”¸ éƒ¨ç½²è„šæœ¬ç»“æ„ï¼šç¯å¢ƒæ£€æŸ¥â†’å¤‡ä»½â†’åœæœâ†’éƒ¨ç½²â†’å¯åŠ¨â†’éªŒè¯â†’æ—¥å¿—
ğŸ”¸ æœåŠ¡å¯åœç®¡ç†ï¼šæŒæ¡Javaã€Node.jsç­‰å¸¸è§åº”ç”¨çš„å¯åœæ–¹æ³•
ğŸ”¸ é…ç½®æ–‡ä»¶åˆ†ç¦»ï¼šæ•æ„Ÿä¿¡æ¯å¤–ç½®ï¼Œæ”¯æŒå¤šç¯å¢ƒå·®å¼‚åŒ–é…ç½®
ğŸ”¸ éªŒè¯ä¸å›æ»šï¼šå¤šå±‚æ¬¡éªŒè¯ç¡®ä¿éƒ¨ç½²è´¨é‡ï¼Œå¤±è´¥æ—¶å¿«é€Ÿå›æ»š
ğŸ”¸ æ—¥å¿—ä¸ç›‘æ§ï¼šè¯¦ç»†è®°å½•éƒ¨ç½²è¿‡ç¨‹ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥å’Œæµç¨‹ä¼˜åŒ–
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è‡ªåŠ¨åŒ–éƒ¨ç½²çš„ä»·å€¼**
```
æ•ˆç‡æå‡ï¼š
- æ‰‹å·¥éƒ¨ç½²ï¼š30-60åˆ†é’Ÿ â†’ è‡ªåŠ¨åŒ–ï¼š3-5åˆ†é’Ÿ
- å‡å°‘é‡å¤åŠ³åŠ¨ï¼Œé‡Šæ”¾äººåŠ›åšæ›´æœ‰ä»·å€¼çš„å·¥ä½œ

è´¨é‡ä¿éšœï¼š
- æ ‡å‡†åŒ–æµç¨‹ï¼Œå‡å°‘äººä¸ºé”™è¯¯
- è‡ªåŠ¨éªŒè¯ï¼Œç¡®ä¿éƒ¨ç½²è´¨é‡
- å¿«é€Ÿå›æ»šï¼Œé™ä½æ•…éšœé£é™©

è¿½è¸ªç®¡ç†ï¼š
- å®Œæ•´çš„æ“ä½œæ—¥å¿—
- å¯è¿½æº¯çš„å˜æ›´è®°å½•
- ä¾¿äºé—®é¢˜å®šä½å’Œåˆ†æ
```

**ğŸ”¹ é…ç½®ç®¡ç†çš„é‡è¦æ€§**
```
å®‰å…¨æ€§ï¼š
- æ•æ„Ÿä¿¡æ¯ä¸èƒ½ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
- ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ä¸­å¿ƒç®¡ç†å¯†é’¥
- ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®

çµæ´»æ€§ï¼š
- é…ç½®å˜æ›´ä¸éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç 
- æ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰
- ä¾¿äºè¿ç»´äººå‘˜ç‹¬ç«‹ç®¡ç†é…ç½®

å¯ç»´æŠ¤æ€§ï¼š
- é›†ä¸­ç®¡ç†é…ç½®ä¿¡æ¯
- ç‰ˆæœ¬æ§åˆ¶é…ç½®å˜æ›´
- é…ç½®é”™è¯¯èƒ½å¿«é€Ÿå›æ»š
```

**ğŸ”¹ ç›‘æ§ä¸æ—¥å¿—çš„ä½œç”¨**
```
é—®é¢˜æ’æŸ¥ï¼š
- è¯¦ç»†çš„éƒ¨ç½²æ—¥å¿—å¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜
- é”™è¯¯ä¿¡æ¯è®°å½•ä¾¿äºå¤ç°å’Œä¿®å¤
- å†å²è®°å½•æ”¯æŒé—®é¢˜è¶‹åŠ¿åˆ†æ

æ€§èƒ½ä¼˜åŒ–ï¼š
- ç›‘æ§å„æ­¥éª¤è€—æ—¶ï¼Œè¯†åˆ«ç“¶é¢ˆ
- æ”¶é›†åº”ç”¨æ€§èƒ½æŒ‡æ ‡
- å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„æ€§èƒ½è¡¨ç°

è¿ç»´ç®¡ç†ï¼š
- è‡ªåŠ¨åŒ–å‘Šè­¦æœºåˆ¶
- éƒ¨ç½²æˆåŠŸç‡ç»Ÿè®¡
- å›¢é˜Ÿåä½œä¸ä¿¡æ¯åŒæ­¥
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ æ–°æ‰‹å…¥é—¨è·¯å¾„**
```
ç¬¬1æ­¥ï¼šç†è§£éƒ¨ç½²æ¦‚å¿µ
- æ˜ç™½ä»€ä¹ˆæ˜¯åº”ç”¨éƒ¨ç½²
- äº†è§£ä¼ ç»Ÿéƒ¨ç½²vsè‡ªåŠ¨åŒ–éƒ¨ç½²çš„å·®å¼‚

ç¬¬2æ­¥ï¼šæŒæ¡åŸºç¡€æŠ€èƒ½
- å­¦ä¼šSSHå…å¯†ç™»å½•é…ç½®
- ç†Ÿç»ƒç¼–å†™Shellè„šæœ¬
- ç†è§£æœåŠ¡å¯åœå‘½ä»¤

ç¬¬3æ­¥ï¼šå®è·µç®€å•éƒ¨ç½²
- ä»å•æœºéƒ¨ç½²å¼€å§‹
- ç¼–å†™åŸºç¡€çš„éƒ¨ç½²è„šæœ¬
- æ·»åŠ ç®€å•çš„éªŒè¯é€»è¾‘

ç¬¬4æ­¥ï¼šå®Œå–„éƒ¨ç½²æµç¨‹
- å¢åŠ å¤‡ä»½å’Œå›æ»šæœºåˆ¶
- å®Œå–„æ—¥å¿—è®°å½•
- æ·»åŠ ç›‘æ§å’Œå‘Šè­¦

ç¬¬5æ­¥ï¼šé«˜çº§ç‰¹æ€§åº”ç”¨
- å¤šç¯å¢ƒé…ç½®ç®¡ç†
- è“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²
- ä¸CI/CDæµæ°´çº¿é›†æˆ
```

**ğŸ”§ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**
```
å®‰å…¨æ€§ï¼š
- ä½¿ç”¨ä¸“ç”¨éƒ¨ç½²è´¦æˆ·ï¼Œæƒé™æœ€å°åŒ–
- æ•æ„Ÿä¿¡æ¯ç»Ÿä¸€ç®¡ç†ï¼Œç¦æ­¢ç¡¬ç¼–ç 
- å®šæœŸæ›´æ–°SSHå¯†é’¥å’Œå¯†ç 

å¯é æ€§ï¼š
- éƒ¨ç½²å‰å¿…é¡»å¤‡ä»½
- å¤šå±‚æ¬¡éªŒè¯ç¡®ä¿è´¨é‡
- å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š

å¯ç»´æŠ¤æ€§ï¼š
- æ ‡å‡†åŒ–éƒ¨ç½²è„šæœ¬æ¨¡æ¿
- è¯¦ç»†çš„æ“ä½œæ–‡æ¡£
- å®Œå–„çš„æ—¥å¿—å’Œç›‘æ§

æ•ˆç‡æ€§ï¼š
- è‡ªåŠ¨åŒ–ç¨‹åº¦è¶Šé«˜è¶Šå¥½
- å‡å°‘äººå·¥å¹²é¢„ç¯èŠ‚
- æŒç»­ä¼˜åŒ–éƒ¨ç½²æµç¨‹
```

### 8.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**ğŸš¨ å…¸å‹é—®é¢˜æ’æŸ¥**
```
éƒ¨ç½²å¤±è´¥å¸¸è§åŸå› ï¼š
1. SSHè¿æ¥é—®é¢˜ â†’ æ£€æŸ¥å¯†é’¥é…ç½®å’Œç½‘ç»œè¿é€šæ€§
2. æƒé™ä¸è¶³ â†’ ç¡®è®¤éƒ¨ç½²è´¦æˆ·æƒé™å’Œæ–‡ä»¶æƒé™
3. ç«¯å£å†²çª â†’ æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
4. é…ç½®é”™è¯¯ â†’ éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼å’Œå†…å®¹
5. èµ„æºä¸è¶³ â†’ æ£€æŸ¥ç£ç›˜ç©ºé—´ã€å†…å­˜ä½¿ç”¨æƒ…å†µ

æ€§èƒ½é—®é¢˜ä¼˜åŒ–ï¼š
1. éƒ¨ç½²æ…¢ â†’ å¹¶è¡ŒåŒ–å¤„ç†ï¼Œä¼˜åŒ–æ–‡ä»¶ä¼ è¾“
2. å¯åŠ¨æ…¢ â†’ è°ƒæ•´JVMå‚æ•°ï¼Œä¼˜åŒ–åº”ç”¨é…ç½®
3. éªŒè¯è¶…æ—¶ â†’ åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¼˜åŒ–å¥åº·æ£€æŸ¥é€»è¾‘

è¿ç»´ç®¡ç†æ”¹è¿›ï¼š
1. ç¼ºä¹ç›‘æ§ â†’ å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»
2. å›æ»šå›°éš¾ â†’ æ ‡å‡†åŒ–å¤‡ä»½å’Œå›æ»šæµç¨‹
3. åä½œæ··ä¹± â†’ å»ºç«‹æ¸…æ™°çš„éƒ¨ç½²è§„èŒƒå’Œæµç¨‹
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- éƒ¨ç½²è‡ªåŠ¨åŒ–ï¼Œæ•ˆç‡è´¨é‡ä½³
- SSHå…å¯†é’¥ï¼Œå®‰å…¨åˆä¾¿æ·  
- è„šæœ¬è¦è§„èŒƒï¼ŒéªŒè¯ä¸èƒ½å°‘
- é…ç½®è¦åˆ†ç¦»ï¼Œå®‰å…¨æ˜¯é¦–è¦
- æ—¥å¿—è¦è¯¦ç»†ï¼Œé—®é¢˜å¥½æ’æŸ¥
- ç›‘æ§è¦å®æ—¶ï¼Œå‘Šè­¦è¦åŠæ—¶

**ğŸ¯ å­¦ä¹ å»ºè®®**ï¼šä»ç®€å•çš„å•æœºéƒ¨ç½²å¼€å§‹ç»ƒä¹ ï¼Œé€æ­¥æŒæ¡å¤‡ä»½ã€éªŒè¯ã€å›æ»šç­‰é«˜çº§ç‰¹æ€§ï¼Œæœ€ç»ˆèƒ½å¤Ÿè®¾è®¡å’Œå®æ–½ä¼ä¸šçº§çš„è‡ªåŠ¨åŒ–éƒ¨ç½²æ–¹æ¡ˆã€‚è®°ä½ï¼Œéƒ¨ç½²ä¸ä»…ä»…æ˜¯æŠŠæ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ï¼Œæ›´é‡è¦çš„æ˜¯ç¡®ä¿æœåŠ¡çš„ç¨³å®šè¿è¡Œå’Œå¿«é€Ÿæ¢å¤èƒ½åŠ›ã€‚