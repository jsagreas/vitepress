---
title: 5、源码管理配置
---
## 📚 目录

1. [源码管理基础概念](#1-源码管理基础概念)
2. [Git仓库连接配置](#2-Git仓库连接配置)
3. [认证凭据管理](#3-认证凭据管理)
4. [分支策略配置](#4-分支策略配置)
5. [自动触发机制](#5-自动触发机制)
6. [高级配置选项](#6-高级配置选项)
7. [实战配置演练](#7-实战配置演练)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔍 源码管理基础概念


### 1.1 什么是源码管理


**通俗理解**：源码管理就像是告诉Jenkins"去哪里拿代码"的过程。

```
简单类比：
你要做菜 → 需要知道去哪个菜市场买菜
Jenkins要构建 → 需要知道去哪个代码仓库拉取代码

Jenkins的工作流程：
1. 从指定的代码仓库下载最新代码
2. 在Jenkins服务器上执行构建操作  
3. 生成最终的应用程序
```

**核心作用**：
- 🔄 **自动拉取代码**：无需手动上传代码文件
- 🎯 **版本控制**：可以指定具体的代码版本或分支
- ⚡ **实时同步**：代码更新后自动触发构建
- 📋 **历史追踪**：记录每次构建使用的代码版本

### 1.2 支持的版本控制系统


**主流选择对比**：

| 版本控制系统 | **使用频率** | **特点** | **适用场景** |
|-------------|-------------|---------|-------------|
| 🔹 **Git** | `⭐⭐⭐⭐⭐` | `分布式、功能强大` | `现代项目的标准选择` |
| 🔹 **SVN** | `⭐⭐⭐` | `集中式、简单易用` | `传统企业项目` |
| 🔹 **Mercurial** | `⭐⭐` | `分布式、轻量` | `小团队项目` |

> **💡 新手建议**：如果你的项目在GitHub、GitLab或码云等平台，那就是Git。现在95%的项目都在用Git。

### 1.3 源码管理在CI/CD中的位置


```
完整的CI/CD流程：

开发者推送代码 → Git仓库 → Jenkins检测到变化 → 自动拉取代码 → 构建测试 → 部署

┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│   开发者      │───▶│   Git仓库    │───▶│   Jenkins    │
│  git push    │    │  (GitHub等)  │    │   自动构建    │
└──────────────┘    └──────────────┘    └──────────────┘
```

---

## 2. 🔗 Git仓库连接配置


### 2.1 仓库URL配置详解


**URL格式说明**：

```
常见的Git仓库URL格式：

🔸 HTTPS方式（推荐新手）：
https://github.com/用户名/仓库名.git
示例：https://github.com/john/my-project.git

🔸 SSH方式（需要密钥）：  
git@github.com:用户名/仓库名.git
示例：git@github.com:john/my-project.git

🔸 企业GitLab：
https://gitlab.company.com/team/project.git
```

**配置步骤**：

```
Jenkins任务配置界面操作：

1. 创建新任务或编辑现有任务
2. 找到"源码管理"(Source Code Management)部分
3. 选择"Git"选项
4. 在"Repository URL"框中输入仓库地址
```

> **⚠️ 常见错误**：URL末尾忘记加`.git`，会导致连接失败

### 2.2 连接测试方法


**验证仓库连接**：

```
配置完URL后的检验方法：

✅ 正常情况：
- URL框下方无红色错误提示
- 可以正常选择分支

❌ 异常情况：
- 红色错误信息："Failed to connect to repository"  
- 原因：URL错误、网络问题、权限不足

解决方案：
1. 检查URL是否正确拼写
2. 确认仓库是否公开（私有仓库需要配置认证）
3. 测试网络连接：ping github.com
```

### 2.3 公开仓库vs私有仓库


**配置差异**：

```
公开仓库配置：
┌─────────────────────────────────┐
│ Repository URL                  │
│ https://github.com/user/repo.git│  ← 直接填写即可
│                                 │
│ Credentials: None               │  ← 无需认证
└─────────────────────────────────┘

私有仓库配置：
┌─────────────────────────────────┐
│ Repository URL                  │
│ https://github.com/user/repo.git│  ← 同样填写URL
│                                 │
│ Credentials: [选择或添加凭据]     │  ← 必须配置认证
└─────────────────────────────────┘
```

---

## 3. 🔐 认证凭据管理


### 3.1 凭据类型详解


**什么是凭据**？
> 凭据就像是你的"身份证"，证明你有权限访问私有代码仓库。

**主要凭据类型**：

```
🔸 用户名密码（Username/Password）
用途：最简单的认证方式
适用：GitHub、GitLab等支持密码登录的平台
示例：GitHub用户名 + 个人访问令牌

🔸 SSH密钥（SSH Key）  
用途：更安全的免密码认证
适用：所有支持SSH的Git平台
特点：一次配置，长期使用

🔸 个人访问令牌（Personal Access Token）
用途：替代密码的安全方式
适用：GitHub、GitLab等现代平台
优势：可以设置具体权限和过期时间
```

### 3.2 创建用户名密码凭据


**操作步骤**：

```
在Jenkins中创建凭据：

1. 进入Jenkins主界面
   ↓
2. 点击"Manage Jenkins"（管理Jenkins）
   ↓  
3. 点击"Manage Credentials"（管理凭据）
   ↓
4. 选择"Global credentials"（全局凭据）
   ↓
5. 点击"Add Credentials"（添加凭据）
```

**配置表单填写**：

| 字段 | **填写内容** | **说明** |
|------|-------------|---------|
| **Kind** | `Username with password` | `凭据类型` |
| **Username** | `你的Git用户名` | `如：john_smith` |
| **Password** | `个人访问令牌` | `不是登录密码！` |
| **ID** | `github-token` | `便于识别的名称` |
| **Description** | `GitHub仓库访问令牌` | `用途说明` |

> **🚨 重要提醒**：GitHub已经不支持密码登录，必须使用Personal Access Token

### 3.3 GitHub个人访问令牌创建


**创建步骤**：

```
在GitHub网站操作：

1. 登录GitHub → 点击右上角头像
2. Settings（设置）→ Developer settings  
3. Personal access tokens → Tokens (classic)
4. Generate new token → Generate new token (classic)
5. 填写token信息：
   - Note: Jenkins访问token
   - Expiration: 1年
   - Select scopes: 勾选 repo（仓库权限）
6. 点击"Generate token"
7. 复制生成的token（只显示一次！）
```

**权限选择说明**：

```
必需权限：
☑️ repo - 仓库完整访问权限
   ├── repo:status - 提交状态访问
   ├── repo_deployment - 部署访问  
   ├── public_repo - 公开仓库访问
   └── repo:invite - 仓库邀请权限

可选权限：
☑️ workflow - GitHub Actions工作流程（如果使用）
☑️ write:packages - 包管理权限（如果需要）
```

### 3.4 SSH密钥配置


**SSH密钥配置流程**：

```
本地生成SSH密钥：

在命令行执行：
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

文件位置：
~/.ssh/id_rsa     ← 私钥（给Jenkins用）
~/.ssh/id_rsa.pub ← 公钥（给GitHub用）
```

**Jenkins中配置SSH凭据**：

| 字段 | **填写内容** | **说明** |
|------|-------------|---------|
| **Kind** | `SSH Username with private key` | `SSH凭据类型` |
| **Username** | `git` | `Git协议用户名` |
| **Private Key** | `粘贴私钥内容` | `id_rsa文件内容` |
| **Passphrase** | `私钥密码（如有）` | `创建密钥时设置的密码` |

---

## 4. 🌿 分支策略配置


### 4.1 分支概念理解


**什么是分支**？
> 分支就像是代码的"平行世界"，不同分支可以有不同版本的代码。

```
典型的分支结构：

main/master分支    ← 生产环境代码，最稳定
├── develop分支    ← 开发环境代码，功能集成
├── feature/login  ← 功能分支，开发登录功能
├── feature/pay    ← 功能分支，开发支付功能  
└── hotfix/bug123  ← 紧急修复分支
```

### 4.2 分支指定方法


**常用分支配置**：

```
🔸 固定分支构建：
Branch Specifier: */main
含义：只构建main分支的代码

🔸 多分支构建：
Branch Specifier: */develop
                 */feature/*
含义：构建develop分支和所有feature开头的分支

🔸 标签构建：
Branch Specifier: */v1.0.0
含义：构建特定版本标签的代码
```

**通配符使用**：

| 配置 | **匹配结果** | **使用场景** |
|------|-------------|-------------|
| `*/main` | `只匹配main分支` | `生产环境部署` |
| `*/develop` | `只匹配develop分支` | `测试环境部署` |
| `*/feature/*` | `所有feature开头分支` | `功能开发测试` |
| `*` | `所有分支` | `全面测试` |

### 4.3 分支构建策略


**策略选择指南**：

```
🎯 单分支策略（推荐新手）：
配置：*/main
优点：简单明确，适合小项目
缺点：所有代码都要合并到main才能测试

🎯 开发测试分支分离：
配置：*/develop（用于测试环境）
     */main（用于生产环境）  
优点：开发和生产环境隔离
缺点：需要管理多个Jenkins任务

🎯 功能分支自动测试：
配置：*/feature/*
优点：每个功能独立测试
缺点：可能产生大量构建任务
```

---

## 5. ⚡ 自动触发机制


### 5.1 触发器类型对比


**触发方式选择**：

```
🔸 轮询SCM（Poll SCM）
工作方式：Jenkins定时检查代码仓库是否有更新
类比：每5分钟看一次手机有没有新消息
优点：配置简单，适合所有Git平台
缺点：有延迟，浪费资源

🔸 Webhook触发
工作方式：代码推送时，Git平台立即通知Jenkins
类比：微信消息来了立即收到通知  
优点：实时响应，资源节省
缺点：需要网络配置，稍微复杂
```

### 5.2 轮询SCM配置


**轮询语法说明**：

```
轮询SCM调度语法（类似Linux cron）：

格式：分 时 日 月 周
示例：
H/5 * * * *    ← 每5分钟检查一次
H/15 * * * *   ← 每15分钟检查一次  
H 9-17 * * 1-5 ← 工作日9-17点每小时检查
0 22 * * *     ← 每天22点检查一次
```

**推荐配置**：

| 项目类型 | **轮询频率** | **配置语法** | **说明** |
|---------|-------------|-------------|---------|
| **活跃开发** | `每5分钟` | `H/5 * * * *` | `快速响应代码变更` |
| **稳定项目** | `每小时` | `H * * * *` | `减少不必要检查` |
| **夜间构建** | `每天晚上` | `0 2 * * *` | `避开工作时间` |

### 5.3 Webhook触发配置


**GitHub Webhook配置**：

```
GitHub仓库设置步骤：

1. 进入你的GitHub仓库
2. 点击Settings → Webhooks  
3. 点击"Add webhook"
4. 填写配置：
   Payload URL: http://你的Jenkins地址/github-webhook/
   Content type: application/json
   Events: Just the push event
5. 点击"Add webhook"
```

**Jenkins端配置**：

```
在Jenkins任务配置中：

构建触发器部分：
☑️ GitHub hook trigger for GITScm polling

这样配置后：
代码推送 → GitHub发送通知 → Jenkins立即开始构建
```

### 5.4 触发条件定制


**高级触发配置**：

```
🔸 特定文件变更触发：
配置路径过滤，只有特定文件夹的代码变更才触发构建
例：只有src/目录变更才构建

🔸 排除特定分支：
Branch Specifier: */main
                 !*/feature/experimental
含义：构建main分支，但排除实验性功能分支

🔸 定时+代码变更组合：
Build periodically: 0 2 * * *  （每天2点构建）
Poll SCM: H/30 * * * *          （每30分钟检查代码）
```

---

## 6. 🔧 高级配置选项


### 6.1 代码检出策略


**检出行为配置**：

```
🔸 Clean before checkout（推荐）
作用：构建前清理工作目录，重新下载代码
优点：确保构建环境干净，避免旧文件干扰
缺点：每次都要重新下载，速度稍慢

🔸 Checkout to sub-directory  
作用：将代码检出到子目录
用途：多仓库项目或特殊目录结构需求

🔸 Timeout配置
作用：设置代码下载超时时间
推荐：10-20分钟（根据仓库大小调整）
```

### 6.2 子模块处理


**什么是Git子模块**？
> 子模块就像是"代码中的代码"，一个项目引用另一个项目的代码。

```
子模块使用场景：
主项目：my-web-app
├── 前端代码
├── 后端代码  
└── 公共库（子模块）← 引用另一个仓库的代码

Jenkins配置：
☑️ Recursively update submodules
☑️ Use credentials from default remote of parent repository
```

### 6.3 浅克隆优化


**性能优化配置**：

```
🔸 Shallow clone（浅克隆）
作用：只下载最近几次提交的代码，不下载完整历史
优点：下载速度快，节省磁盘空间
适用：大型项目，历史记录很长的仓库

配置方法：
Advanced clone behaviours → Shallow clone
Shallow clone depth: 1  （只克隆最新提交）
```

### 6.4 并发构建控制


**资源管理配置**：

```
🔸 构建并发限制
问题：多个分支同时触发构建，服务器资源不足
解决：限制同时运行的构建数量

配置位置：
Jenkins系统配置 → 执行器数量设置
推荐：CPU核心数 × 1.5

🔸 分支构建策略
配置：只保留最新构建，取消排队中的旧构建
作用：避免过时代码的无意义构建
```

---

## 7. 🎯 实战配置演练


### 7.1 完整配置示例


**场景**：为一个React项目配置Jenkins源码管理

```
项目信息：
- 仓库：https://github.com/company/react-app.git
- 主分支：main
- 开发分支：develop  
- 需求：代码推送时自动构建
```

**配置清单**：

```
✅ 第一步：基础仓库配置
Repository URL: https://github.com/company/react-app.git
Credentials: github-token（预先创建的凭据）

✅ 第二步：分支配置  
Branch Specifier: */main
                 */develop

✅ 第三步：触发器配置
☑️ GitHub hook trigger for GITScm polling
☑️ Poll SCM: H/15 * * * *（备用轮询）

✅ 第四步：高级选项
☑️ Clean before checkout
☑️ Shallow clone (depth: 5)
```

### 7.2 配置验证步骤


**测试配置是否正确**：

```
🔸 立即构建测试：
1. 保存Jenkins配置
2. 点击"立即构建"
3. 查看构建日志是否成功下载代码

🔸 自动触发测试：
1. 在本地修改代码并推送
2. 观察Jenkins是否自动开始构建
3. 检查构建日志中的代码版本信息

🔸 常见问题排查：
- 构建失败：检查凭据配置
- 触发器不工作：检查Webhook配置
- 代码版本错误：检查分支配置
```

### 7.3 最佳实践总结


**配置建议**：

```
🎯 新手推荐配置：
✅ 使用HTTPS + Personal Access Token认证
✅ 先配置单个主分支（*/main）
✅ 使用轮询SCM触发（H/10 * * * *）
✅ 开启Clean before checkout

🎯 进阶优化配置：
✅ 配置Webhook实时触发  
✅ 多分支并行构建
✅ 浅克隆提升性能
✅ 构建历史清理策略
```

### 7.4 故障排除指南


**常见问题及解决方案**：

| 问题现象 | **可能原因** | **解决方法** |
|---------|-------------|-------------|
| `连接仓库失败` | `URL错误或网络问题` | `检查URL格式，测试网络连接` |
| `认证失败` | `凭据配置错误` | `重新创建Personal Access Token` |
| `分支找不到` | `分支名称错误` | `确认分支是否存在，检查拼写` |
| `触发器不工作` | `Webhook配置问题` | `检查GitHub Webhook设置` |

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本概念


```
🔸 源码管理：告诉Jenkins从哪里获取代码
🔸 Git仓库URL：代码存放的网络地址
🔸 认证凭据：访问私有仓库的"通行证"
🔸 分支策略：决定构建哪些版本的代码
🔸 自动触发：代码变更时自动开始构建
🔸 检出策略：如何下载和管理代码文件
```

### 8.2 关键配置要点


**🔹 认证配置核心**
```
新手最佳选择：
- HTTPS URL + Personal Access Token
- 避免使用密码（已被禁用）
- SSH密钥适合高级用户

记住要点：
- GitHub Token权限至少需要repo
- 凭据ID要容易识别
- 定期更新过期的Token
```

**🔹 分支管理策略**  
```
简单项目：*/main（只构建主分支）
复杂项目：*/main + */develop（分环境构建）
功能开发：*/feature/*（功能分支测试）

选择原则：
- 新手从单分支开始
- 根据团队工作流程调整
- 避免过度复杂的分支策略
```

**🔹 触发器选择指南**
```
轮询SCM：配置简单，适合新手
- 语法：H/10 * * * *（每10分钟检查）
- 优点：稳定可靠
- 缺点：有延迟

Webhook：响应快速，适合生产
- 需要配置GitHub Webhook
- 优点：实时触发
- 缺点：依赖网络配置
```

### 8.3 实用操作技巧


**🎯 提升效率的配置**
- ✅ 使用浅克隆加速代码下载
- ✅ 开启构建前清理确保环境干净  
- ✅ 合理设置轮询频率避免资源浪费
- ✅ 配置构建历史清理策略

**🎯 避免常见错误**
- ❌ 不要在密码字段填写登录密码
- ❌ 不要遗漏Git URL的.git后缀
- ❌ 不要在生产环境使用过于频繁的轮询
- ❌ 不要忽略分支名称的大小写

### 8.4 学习路径建议


**🚀 新手学习顺序**
```
第一步：配置公开仓库（无需认证）
第二步：学会创建Personal Access Token  
第三步：配置私有仓库认证
第四步：掌握分支策略配置
第五步：设置自动触发机制
第六步：优化性能和故障排除
```

**🎓 进阶学习方向**
- 多仓库项目管理
- 复杂分支工作流程
- Git子模块处理
- 构建性能优化
- 安全最佳实践

**核心记忆口诀**：
```
源码管理连接Git，URL凭据要配对
分支策略定规则，触发方式选得当  
轮询简单Webhook快，检出策略保干净
配置验证不可少，故障排查有方法
```