---
title: 5ã€æ¶ˆæ¯è®¾è®¡æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [æ¶ˆæ¯è®¾è®¡æ¦‚è¿°](#1-æ¶ˆæ¯è®¾è®¡æ¦‚è¿°)
2. [æ¶ˆæ¯ç»“æ„è®¾è®¡](#2-æ¶ˆæ¯ç»“æ„è®¾è®¡)
3. [æ¶ˆæ¯å¤´è®¾è®¡æ¨¡å¼](#3-æ¶ˆæ¯å¤´è®¾è®¡æ¨¡å¼)
4. [æ¶ˆæ¯ä½“è®¾è®¡ç­–ç•¥](#4-æ¶ˆæ¯ä½“è®¾è®¡ç­–ç•¥)
5. [æ¶ˆæ¯é”®è®¾è®¡åŸåˆ™](#5-æ¶ˆæ¯é”®è®¾è®¡åŸåˆ™)
6. [æ¶ˆæ¯ç‰ˆæœ¬ç®¡ç†](#6-æ¶ˆæ¯ç‰ˆæœ¬ç®¡ç†)
7. [æ¶ˆæ¯è·¯ç”±æ¨¡å¼](#7-æ¶ˆæ¯è·¯ç”±æ¨¡å¼)
8. [æ¶ˆæ¯è¿‡æ»¤æ¨¡å¼](#8-æ¶ˆæ¯è¿‡æ»¤æ¨¡å¼)
9. [æ¶ˆæ¯è½¬æ¢æ¨¡å¼](#9-æ¶ˆæ¯è½¬æ¢æ¨¡å¼)
10. [é‡è¯•å’Œè¡¥å¿æ¨¡å¼](#10-é‡è¯•å’Œè¡¥å¿æ¨¡å¼)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ æ¶ˆæ¯è®¾è®¡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯è®¾è®¡æ¨¡å¼


**ç®€å•ç†è§£**ï¼šæ¶ˆæ¯è®¾è®¡æ¨¡å¼å°±æ˜¯è®¾è®¡Kafkaæ¶ˆæ¯çš„"æ ‡å‡†æ ¼å¼"ï¼Œå°±åƒå†™ä¿¡è¦æœ‰å›ºå®šæ ¼å¼ä¸€æ ·ã€‚

```
æƒ³è±¡å†™ä¸€å°ä¿¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ”¶ä»¶äººï¼šå¼ ä¸‰     â”‚ â† æ¶ˆæ¯å¤´ä¿¡æ¯
â”‚ å‘ä»¶äººï¼šæå››     â”‚
â”‚ æ—¥æœŸï¼š2024-01-01 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ­£æ–‡å†…å®¹ï¼š       â”‚ â† æ¶ˆæ¯ä½“å†…å®¹
â”‚ ä½ å¥½ï¼Œæœ€è¿‘...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Kafkaæ¶ˆæ¯ä¹Ÿéœ€è¦è¿™æ ·çš„ç»“æ„ï¼
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯è®¾è®¡æ¨¡å¼


**æ ¸å¿ƒé—®é¢˜**ï¼š
- **æ··ä¹±çš„æ¶ˆæ¯**ï¼šæ¯ä¸ªå¼€å‘è€…éƒ½æŒ‰è‡ªå·±æƒ³æ³•å‘æ¶ˆæ¯ï¼Œæ ¼å¼ä¸ç»Ÿä¸€
- **éš¾ä»¥ç»´æŠ¤**ï¼šåæœŸæƒ³ä¿®æ”¹æ¶ˆæ¯æ ¼å¼ï¼Œå½±å“æ‰€æœ‰ç³»ç»Ÿ
- **å¤„ç†å›°éš¾**ï¼šæ¶ˆè´¹è€…ä¸çŸ¥é“æ¶ˆæ¯é‡Œæœ‰ä»€ä¹ˆï¼Œæ€ä¹ˆå¤„ç†

**è®¾è®¡æ¨¡å¼çš„å¥½å¤„**ï¼š
```
âœ… æ ‡å‡†ç»Ÿä¸€ï¼šæ‰€æœ‰æ¶ˆæ¯éƒ½æŒ‰åŒæ ·æ ¼å¼
âœ… æ˜“äºæ‰©å±•ï¼šæ–°å¢å­—æ®µä¸å½±å“æ—§ç³»ç»Ÿ
âœ… ä¾¿äºç»´æŠ¤ï¼šç»Ÿä¸€çš„å¤„ç†é€»è¾‘
âœ… å‡å°‘é”™è¯¯ï¼šæ ‡å‡†åŒ–å‡å°‘è§£æé”™è¯¯
```

### 1.3 æ¶ˆæ¯è®¾è®¡çš„åŸºæœ¬åŸåˆ™


```
ğŸ¯ è®¾è®¡åŸåˆ™ï¼š
1. ç®€å•æ˜äº† - å­—æ®µå«ä¹‰æ¸…æ¥š
2. å‘å‰å…¼å®¹ - æ–°ç‰ˆæœ¬ä¸ç ´åæ—§ç‰ˆæœ¬
3. é«˜æ•ˆç´§å‡‘ - å‡å°‘ç½‘ç»œä¼ è¾“å¼€é”€
4. æ˜“äºè°ƒè¯• - åŒ…å«è¶³å¤Ÿçš„è¯Šæ–­ä¿¡æ¯
5. ä¸šåŠ¡è¯­ä¹‰ - ä½“ç°ä¸šåŠ¡å«ä¹‰
```

---

## 2. ğŸ—ï¸ æ¶ˆæ¯ç»“æ„è®¾è®¡


### 2.1 å…¸å‹æ¶ˆæ¯ç»“æ„


Kafkaæ¶ˆæ¯ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

```
Kafkaæ¶ˆæ¯å®Œæ•´ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Keyï¼ˆæ¶ˆæ¯é”®ï¼‰    â”‚ â† å†³å®šåˆ†åŒºï¼Œå¯é€‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Headersï¼ˆå¤´éƒ¨ï¼‰  â”‚ â† å…ƒæ•°æ®ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Valueï¼ˆæ¶ˆæ¯ä½“ï¼‰  â”‚ â† å®é™…ä¸šåŠ¡æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¶ˆæ¯ç»“æ„å±‚æ¬¡è®¾è®¡


**ğŸ”¸ ä¸‰å±‚ç»“æ„æ¨¡å‹**

```
ç¬¬ä¸€å±‚ï¼šä¼ è¾“å±‚ï¼ˆKafkaåŸç”Ÿï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Topic           â”‚
â”‚ Partition       â”‚
â”‚ Offset          â”‚
â”‚ Timestamp       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒå±‚ï¼šåè®®å±‚ï¼ˆè‡ªå®šä¹‰Headersï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ message-id      â”‚
â”‚ message-type    â”‚
â”‚ version         â”‚
â”‚ source-service  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸‰å±‚ï¼šä¸šåŠ¡å±‚ï¼ˆValueå†…å®¹ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…·ä½“ä¸šåŠ¡æ•°æ®     â”‚
â”‚ å¦‚ï¼šç”¨æˆ·ä¿¡æ¯ã€   â”‚
â”‚ è®¢å•æ•°æ®ç­‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ¶ˆæ¯åŒ…è£…å™¨è®¾è®¡


**ğŸ’¡ ç»Ÿä¸€æ¶ˆæ¯å°è£…**ï¼š

```java
// é€šç”¨æ¶ˆæ¯åŒ…è£…å™¨
public class MessageWrapper<T> {
    // æ¶ˆæ¯å…ƒæ•°æ®
    private String messageId;      // æ¶ˆæ¯å”¯ä¸€ID
    private String messageType;    // æ¶ˆæ¯ç±»å‹
    private String version;        // æ¶ˆæ¯ç‰ˆæœ¬
    private Long timestamp;        // æ—¶é—´æˆ³
    private String source;         // æ¥æºæœåŠ¡
    
    // ä¸šåŠ¡æ•°æ®
    private T payload;             // å®é™…ä¸šåŠ¡æ•°æ®
    
    // æ‰©å±•å­—æ®µ
    private Map<String, String> attributes; // è‡ªå®šä¹‰å±æ€§
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// å‘é€ç”¨æˆ·æ³¨å†Œæ¶ˆæ¯
UserRegistered userEvent = new UserRegistered("user123", "å¼ ä¸‰");

MessageWrapper<UserRegistered> message = MessageWrapper.<UserRegistered>builder()
    .messageId(UUID.randomUUID().toString())
    .messageType("USER_REGISTERED")
    .version("1.0")
    .timestamp(System.currentTimeMillis())
    .source("user-service")
    .payload(userEvent)
    .build();
```

---

## 3. ğŸ“‹ æ¶ˆæ¯å¤´è®¾è®¡æ¨¡å¼


### 3.1 æ ‡å‡†æ¶ˆæ¯å¤´å­—æ®µ


æ¶ˆæ¯å¤´å°±åƒä¿¡å°ä¸Šçš„ä¿¡æ¯ï¼Œå‘Šè¯‰æˆ‘ä»¬æ¶ˆæ¯çš„åŸºæœ¬æƒ…å†µï¼š

| å¤´å­—æ®µå | **å«ä¹‰** | **ä½œç”¨** | **ç¤ºä¾‹å€¼** |
|---------|---------|---------|-----------|
| `message-id` | `æ¶ˆæ¯å”¯ä¸€æ ‡è¯†` | `å»é‡ã€è¿½è¸ª` | `msg-001-2024` |
| `message-type` | `æ¶ˆæ¯ç±»å‹` | `è·¯ç”±ã€å¤„ç†` | `USER_CREATED` |
| `version` | `æ¶ˆæ¯ç‰ˆæœ¬` | `å…¼å®¹æ€§å¤„ç†` | `1.0` |
| `timestamp` | `å‘é€æ—¶é—´` | `æ—¶åºã€è¿‡æœŸ` | `1642752000000` |
| `source` | `æ¥æºæœåŠ¡` | `è¿½è¸ªã€è°ƒè¯•` | `user-service` |
| `correlation-id` | `å…³è”ID` | `é“¾è·¯è¿½è¸ª` | `trace-123` |

### 3.2 æ¶ˆæ¯å¤´è®¾è®¡æœ€ä½³å®è·µ


**ğŸ”¸ å¿…éœ€å¤´å­—æ®µ**ï¼š
```java
// å‘é€æ¶ˆæ¯æ—¶è®¾ç½®å¤´éƒ¨
ProducerRecord<String, String> record = new ProducerRecord<>(
    "user-events",  // topic
    "user123",      // key
    userJson        // value
);

// è®¾ç½®æ ‡å‡†å¤´éƒ¨
record.headers().add("message-type", "USER_REGISTERED".getBytes());
record.headers().add("version", "1.0".getBytes());
record.headers().add("timestamp", String.valueOf(System.currentTimeMillis()).getBytes());
record.headers().add("source", "user-service".getBytes());
```

**ğŸ’¡ å¤´å­—æ®µå‘½åè§„èŒƒ**ï¼š
```
âœ… ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦ï¼šmessage-type
âœ… è§åçŸ¥æ„ï¼šsourceã€destination
âœ… ä¿æŒä¸€è‡´ï¼šç»Ÿä¸€çš„å‘½åé£æ ¼
âŒ é¿å…ç¼©å†™ï¼šmsg_tpï¼ˆä¸æ¸…æ¥šå«ä¹‰ï¼‰
âŒ é¿å…ä¸­æ–‡ï¼šæ¶ˆæ¯ç±»å‹
```

### 3.3 ä¸šåŠ¡ç›¸å…³å¤´å­—æ®µ


```java
// ç”µå•†ä¸šåŠ¡ç›¸å…³å¤´å­—æ®µç¤ºä¾‹
record.headers().add("tenant-id", "tenant001".getBytes());        // ç§Ÿæˆ·ID
record.headers().add("user-id", "user123".getBytes());            // ç”¨æˆ·ID
record.headers().add("request-id", "req-456".getBytes());         // è¯·æ±‚ID
record.headers().add("event-type", "ORDER_CREATED".getBytes());   // äº‹ä»¶ç±»å‹
record.headers().add("priority", "HIGH".getBytes());              // æ¶ˆæ¯ä¼˜å…ˆçº§
```

---

## 4. ğŸ“¦ æ¶ˆæ¯ä½“è®¾è®¡ç­–ç•¥


### 4.1 æ¶ˆæ¯ä½“æ ¼å¼é€‰æ‹©


**ğŸ”¸ å¸¸è§æ ¼å¼å¯¹æ¯”**ï¼š

| æ ¼å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| `JSON` | `å¯è¯»æ€§å¥½ï¼Œæ˜“è°ƒè¯•` | `ä½“ç§¯å¤§ï¼Œè§£ææ…¢` | `å¼€å‘æµ‹è¯•ï¼Œå°‘é‡æ•°æ®` |
| `Avro` | `å‹ç¼©ç‡é«˜ï¼Œæœ‰Schema` | `éœ€è¦Schemaæ³¨å†Œ` | `å¤§æ•°æ®é‡ï¼Œç”Ÿäº§ç¯å¢ƒ` |
| `Protobuf` | `é«˜æ•ˆï¼Œè·¨è¯­è¨€` | `éœ€è¦å®šä¹‰protoæ–‡ä»¶` | `å¾®æœåŠ¡é—´é€šä¿¡` |

**JSONæ ¼å¼ç¤ºä¾‹**ï¼š
```json
{
  "userId": "user123",
  "userName": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "registeredAt": "2024-01-01T10:00:00Z",
  "profile": {
    "age": 25,
    "city": "åŒ—äº¬"
  }
}
```

### 4.2 æ¶ˆæ¯ä½“ç»“æ„è®¾è®¡


**ğŸ¯ åˆ†å±‚è®¾è®¡**ï¼š
```json
{
  "metadata": {
    "eventId": "evt-123",
    "eventTime": "2024-01-01T10:00:00Z",
    "eventType": "USER_REGISTERED"
  },
  "data": {
    "before": null,
    "after": {
      "userId": "user123",
      "userName": "å¼ ä¸‰",
      "status": "ACTIVE"
    }
  },
  "context": {
    "source": "user-service",
    "operation": "INSERT"
  }
}
```

### 4.3 å­—æ®µè®¾è®¡åŸåˆ™


**âœ… å¥½çš„å­—æ®µè®¾è®¡**ï¼š
```json
{
  "orderId": "ORD20240101001",           // æ¸…æ™°çš„ä¸šåŠ¡ID
  "customerId": "CUST123",              // æ˜ç¡®çš„å®¢æˆ·æ ‡è¯†
  "orderAmount": 199.99,                // ä½¿ç”¨æ•°å­—ç±»å‹
  "currency": "CNY",                    // æ˜ç¡®çš„è´§å¸å•ä½
  "orderStatus": "PENDING",             // æšä¸¾å€¼æ¸…æ™°
  "createdAt": "2024-01-01T10:00:00Z",  // ISO8601æ—¶é—´æ ¼å¼
  "items": [                            // æ•°ç»„ç»“æ„æ¸…æ™°
    {
      "productId": "PROD001",
      "quantity": 2,
      "unitPrice": 99.99
    }
  ]
}
```

---

## 5. ğŸ”‘ æ¶ˆæ¯é”®è®¾è®¡åŸåˆ™


### 5.1 æ¶ˆæ¯é”®çš„ä½œç”¨


**æ¶ˆæ¯é”®å°±åƒå¿«é€’çš„åœ°å€æ ‡ç­¾**ï¼Œå†³å®šæ¶ˆæ¯è¢«é€åˆ°å“ªä¸ªåˆ†åŒºï¼š

```
æ¶ˆæ¯é”®çš„ä¸‰å¤§ä½œç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ†åŒºè·¯ç”±      â”‚ â† å†³å®šæ¶ˆæ¯å­˜å‚¨åœ¨å“ªä¸ªåˆ†åŒº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. æ¶ˆæ¯æ’åº      â”‚ â† åŒä¸€ä¸ªKeyçš„æ¶ˆæ¯æœ‰åº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. æ¶ˆè´¹è€…äº²å’Œæ€§   â”‚ â† ä¾¿äºæ¶ˆè´¹è€…å¤„ç†ç›¸å…³æ¶ˆæ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ¶ˆæ¯é”®è®¾è®¡ç­–ç•¥


**ğŸ”¸ ä¸šåŠ¡ä¸»é”®ä½œä¸ºæ¶ˆæ¯é”®**ï¼š
```java
// ç”¨æˆ·ç›¸å…³æ¶ˆæ¯ï¼Œç”¨userIdä½œä¸ºKey
producer.send(new ProducerRecord<>(
    "user-events",
    "user123",        // Key: ç”¨æˆ·ID
    userEventJson     // Value: ç”¨æˆ·äº‹ä»¶æ•°æ®
));

// è®¢å•ç›¸å…³æ¶ˆæ¯ï¼Œç”¨orderIdä½œä¸ºKey  
producer.send(new ProducerRecord<>(
    "order-events", 
    "order456",       // Key: è®¢å•ID
    orderEventJson    // Value: è®¢å•äº‹ä»¶æ•°æ®
));
```

**ğŸ”¸ å¤åˆé”®è®¾è®¡**ï¼š
```java
// å¤šç»´åº¦å¤åˆé”®ï¼šç§Ÿæˆ·ID + ç”¨æˆ·ID
String compositeKey = "tenant001:user123";

producer.send(new ProducerRecord<>(
    "multi-tenant-events",
    compositeKey,     // Key: å¤åˆé”®
    eventJson         // Value: äº‹ä»¶æ•°æ®
));
```

### 5.3 é”®è®¾è®¡æ³¨æ„äº‹é¡¹


**âš ï¸ å¸¸è§é—®é¢˜**ï¼š
```
é—®é¢˜1ï¼šé”®å€¼åˆ†å¸ƒä¸å‡
âŒ æ‰€æœ‰æ¶ˆæ¯ç”¨åŒä¸€ä¸ªKey â†’ æ‰€æœ‰æ¶ˆæ¯è¿›å…¥åŒä¸€åˆ†åŒº
âœ… ä½¿ç”¨ä¸šåŠ¡ç›¸å…³çš„å”¯ä¸€æ ‡è¯†ä½œä¸ºKey

é—®é¢˜2ï¼šé”®å€¼è¿‡äºåˆ†æ•£  
âŒ ç”¨æ—¶é—´æˆ³ä½œä¸ºKey â†’ æ¶ˆæ¯æ— æ³•æœ‰åºå¤„ç†
âœ… ç”¨ä¸šåŠ¡å®ä½“IDï¼Œä¿è¯ç›¸å…³æ¶ˆæ¯æœ‰åº

é—®é¢˜3ï¼šé”®å€¼ä¸ºç©º
âŒ ä¸è®¾ç½®Key â†’ æ¶ˆæ¯éšæœºåˆ†é…åˆ†åŒºï¼Œæ— æ³•ä¿è¯é¡ºåº
âœ… æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆç†è®¾ç½®Key
```

---

## 6. ğŸ”„ æ¶ˆæ¯ç‰ˆæœ¬ç®¡ç†


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬ç®¡ç†


**ç°å®åœºæ™¯**ï¼š
```
ç³»ç»Ÿæ¼”è¿›è¿‡ç¨‹ï¼š
v1.0: ç”¨æˆ·æ³¨å†Œæ¶ˆæ¯åªæœ‰ {userId, userName}
v2.0: æ–°å¢é‚®ç®±å­—æ®µ {userId, userName, email}  
v3.0: æ–°å¢æ‰‹æœºå· {userId, userName, email, phone}

å¦‚æœæ²¡æœ‰ç‰ˆæœ¬ç®¡ç†ï¼š
- è€ç³»ç»Ÿæ— æ³•å¤„ç†æ–°å­—æ®µ
- æ–°ç³»ç»Ÿä¸çŸ¥é“æ¶ˆæ¯ç‰ˆæœ¬
- å‡çº§æ—¶å®¹æ˜“å‡ºé”™
```

### 6.2 ç‰ˆæœ¬ç®¡ç†ç­–ç•¥


**ğŸ”¸ åœ¨æ¶ˆæ¯å¤´ä¸­æ ‡è®°ç‰ˆæœ¬**ï¼š
```java
// å‘é€v1.0ç‰ˆæœ¬çš„æ¶ˆæ¯
ProducerRecord<String, String> recordV1 = new ProducerRecord<>(
    "user-events", "user123", userV1Json
);
recordV1.headers().add("version", "1.0".getBytes());

// å‘é€v2.0ç‰ˆæœ¬çš„æ¶ˆæ¯
ProducerRecord<String, String> recordV2 = new ProducerRecord<>(
    "user-events", "user123", userV2Json  
);
recordV2.headers().add("version", "2.0".getBytes());
```

**ğŸ”¸ æ¶ˆè´¹è€…ç‰ˆæœ¬å¤„ç†**ï¼š
```java
@Service
public class UserEventConsumer {
    
    @KafkaListener(topics = "user-events")
    public void handleUserEvent(ConsumerRecord<String, String> record) {
        // è·å–æ¶ˆæ¯ç‰ˆæœ¬
        String version = new String(record.headers().lastHeader("version").value());
        
        // æ ¹æ®ç‰ˆæœ¬å¤„ç†æ¶ˆæ¯
        switch (version) {
            case "1.0":
                handleV1Message(record.value());
                break;
            case "2.0": 
                handleV2Message(record.value());
                break;
            default:
                log.warn("æœªçŸ¥æ¶ˆæ¯ç‰ˆæœ¬: {}", version);
        }
    }
}
```

### 6.3 å‘å‰å…¼å®¹è®¾è®¡


**ğŸ’¡ å…¼å®¹æ€§è®¾è®¡åŸåˆ™**ï¼š

```
å…¼å®¹æ€§ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åªå¢åŠ å­—æ®µ    â”‚ â† ä¸åˆ é™¤ã€ä¸ä¿®æ”¹å·²æœ‰å­—æ®µ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ 2. å­—æ®µæœ‰é»˜è®¤å€¼   â”‚ â† æ–°å­—æ®µè¦æœ‰åˆç†é»˜è®¤å€¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. å¯é€‰å­—æ®µä¼˜å…ˆ   â”‚ â† å°½é‡è®¾è®¡ä¸ºå¯é€‰å­—æ®µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¤ºä¾‹ï¼šç”¨æˆ·æ¶ˆæ¯æ¼”è¿›
v1.0: {"userId": "123", "name": "å¼ ä¸‰"}
v2.0: {"userId": "123", "name": "å¼ ä¸‰", "email": "abc@qq.com"}  // å¢åŠ email
v3.0: {"userId": "123", "name": "å¼ ä¸‰", "email": "abc@qq.com", "phone": "13800138000"}  // å¢åŠ phone
```

---

## 7. ğŸ›£ï¸ æ¶ˆæ¯è·¯ç”±æ¨¡å¼


### 7.1 åŸºäºæ¶ˆæ¯ç±»å‹è·¯ç”±


**æ ¸å¿ƒæ€æƒ³**ï¼šæ ¹æ®æ¶ˆæ¯ç±»å‹å°†ä¸åŒçš„æ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„Topicã€‚

```
æ¶ˆæ¯è·¯ç”±ç¤ºä¾‹ï¼š
ç”¨æˆ·äº‹ä»¶ â†’ user-events Topic
è®¢å•äº‹ä»¶ â†’ order-events Topic  
æ”¯ä»˜äº‹ä»¶ â†’ payment-events Topic

è·¯ç”±é€»è¾‘ï¼š
if (messageType.startsWith("USER_")) {
    topic = "user-events";
} else if (messageType.startsWith("ORDER_")) {
    topic = "order-events";  
} else if (messageType.startsWith("PAYMENT_")) {
    topic = "payment-events";
}
```

**ä»£ç å®ç°**ï¼š
```java
@Service
public class MessageRouter {
    
    private static final Map<String, String> ROUTE_MAP = Map.of(
        "USER_", "user-events",
        "ORDER_", "order-events", 
        "PAYMENT_", "payment-events"
    );
    
    public String getTopicForMessage(String messageType) {
        return ROUTE_MAP.entrySet().stream()
            .filter(entry -> messageType.startsWith(entry.getKey()))
            .map(Map.Entry::getValue)
            .findFirst()
            .orElse("default-events");  // é»˜è®¤Topic
    }
}
```

### 7.2 åŸºäºå†…å®¹è·¯ç”±


**åœºæ™¯**ï¼šæ ¹æ®æ¶ˆæ¯å†…å®¹å†³å®šè·¯ç”±ç›®æ ‡ã€‚

```java
@Component  
public class ContentBasedRouter {
    
    public String routeOrder(OrderEvent orderEvent) {
        // æ ¹æ®è®¢å•é‡‘é¢è·¯ç”±åˆ°ä¸åŒTopic
        if (orderEvent.getAmount() > 1000) {
            return "high-value-orders";
        } else {
            return "regular-orders";
        }
    }
    
    public String routeUser(UserEvent userEvent) {
        // æ ¹æ®ç”¨æˆ·ç±»å‹è·¯ç”±
        if ("VIP".equals(userEvent.getUserType())) {
            return "vip-user-events";
        } else {
            return "regular-user-events";
        }
    }
}
```

### 7.3 å¤šæ’­è·¯ç”±æ¨¡å¼


**åº”ç”¨åœºæ™¯**ï¼šä¸€ä¸ªäº‹ä»¶éœ€è¦è¢«å¤šä¸ªç³»ç»Ÿå¤„ç†ã€‚

```
è®¢å•åˆ›å»ºäº‹ä»¶å¹¿æ’­ï¼š
Order Created Event
       â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è·¯ç”±å™¨   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†™   â†“   â†˜
åº“å­˜ç³»ç»Ÿ æ”¯ä»˜ç³»ç»Ÿ ç‰©æµç³»ç»Ÿ
```

**å®ç°æ–¹å¼**ï¼š
```java
@EventListener
public void handleOrderCreated(OrderCreatedEvent event) {
    // å‘é€åˆ°å¤šä¸ªTopic
    List<String> targetTopics = Arrays.asList(
        "inventory-events",    // åº“å­˜ç³»ç»Ÿ
        "payment-events",      // æ”¯ä»˜ç³»ç»Ÿ  
        "logistics-events"     // ç‰©æµç³»ç»Ÿ
    );
    
    for (String topic : targetTopics) {
        kafkaTemplate.send(topic, event.getOrderId(), event);
    }
}
```

---

## 8. ğŸ” æ¶ˆæ¯è¿‡æ»¤æ¨¡å¼


### 8.1 ç”Ÿäº§è€…ç«¯è¿‡æ»¤


**æ ¸å¿ƒæ€æƒ³**ï¼šåœ¨å‘é€æ¶ˆæ¯æ—¶å°±è¿›è¡Œç­›é€‰ï¼Œåªå‘é€éœ€è¦çš„æ¶ˆæ¯ã€‚

```java
@Service
public class FilteredMessageProducer {
    
    // åªå‘é€é‡è¦çº§åˆ«çš„ç”¨æˆ·äº‹ä»¶
    public void sendUserEvent(UserEvent event) {
        if (shouldSendEvent(event)) {
            kafkaTemplate.send("user-events", event.getUserId(), event);
        }
    }
    
    private boolean shouldSendEvent(UserEvent event) {
        // è¿‡æ»¤é€»è¾‘ï¼šåªå‘é€VIPç”¨æˆ·æˆ–é‡è¦äº‹ä»¶
        return "VIP".equals(event.getUserType()) || 
               event.getEventType().startsWith("CRITICAL_");
    }
}
```

### 8.2 æ¶ˆè´¹è€…ç«¯è¿‡æ»¤


**åº”ç”¨åœºæ™¯**ï¼šæ¶ˆè´¹è€…åªå¤„ç†è‡ªå·±å…³å¿ƒçš„æ¶ˆæ¯ã€‚

```java
@KafkaListener(topics = "all-events")
public void handleEvents(ConsumerRecord<String, String> record) {
    String messageType = new String(record.headers().lastHeader("message-type").value());
    
    // æ¶ˆè´¹è€…è¿‡æ»¤ï¼šåªå¤„ç†è®¢å•ç›¸å…³äº‹ä»¶
    if (messageType.startsWith("ORDER_")) {
        processOrderEvent(record.value());
    } else {
        log.debug("å¿½ç•¥æ¶ˆæ¯ç±»å‹: {}", messageType);
    }
}
```

### 8.3 åŸºäºå¤´éƒ¨çš„è¿‡æ»¤


**æ›´çµæ´»çš„è¿‡æ»¤æ–¹å¼**ï¼š
```java
public class HeaderBasedFilter {
    
    public boolean shouldProcess(ConsumerRecord<String, String> record) {
        Headers headers = record.headers();
        
        // æ ¹æ®å¤šä¸ªå¤´éƒ¨å­—æ®µè¿›è¡Œè¿‡æ»¤
        String priority = getHeaderValue(headers, "priority");
        String region = getHeaderValue(headers, "region");
        String tenantId = getHeaderValue(headers, "tenant-id");
        
        // è¿‡æ»¤æ¡ä»¶ï¼šé«˜ä¼˜å…ˆçº§ ä¸” æŒ‡å®šåœ°åŒº ä¸” æŒ‡å®šç§Ÿæˆ·
        return "HIGH".equals(priority) && 
               "BEIJING".equals(region) && 
               "tenant001".equals(tenantId);
    }
    
    private String getHeaderValue(Headers headers, String key) {
        Header header = headers.lastHeader(key);
        return header != null ? new String(header.value()) : null;
    }
}
```

---

## 9. ğŸ”„ æ¶ˆæ¯è½¬æ¢æ¨¡å¼


### 9.1 æ ¼å¼è½¬æ¢æ¨¡å¼


**ä½¿ç”¨åœºæ™¯**ï¼šä¸åŒç³»ç»Ÿä½¿ç”¨ä¸åŒçš„æ¶ˆæ¯æ ¼å¼ã€‚

```
è½¬æ¢ç¤ºä¾‹ï¼š
JSONæ ¼å¼ â†’ Avroæ ¼å¼
XMLæ ¼å¼ â†’ JSONæ ¼å¼
è‡ªå®šä¹‰æ ¼å¼ â†’ æ ‡å‡†æ ¼å¼
```

**ä»£ç å®ç°**ï¼š
```java
@Component
public class MessageTransformer {
    
    // JSONè½¬Avro
    public GenericRecord jsonToAvro(String jsonMessage, Schema schema) {
        try {
            JsonNode jsonNode = objectMapper.readTree(jsonMessage);
            
            GenericRecord record = new GenericData.Record(schema);
            record.put("userId", jsonNode.get("userId").asText());
            record.put("userName", jsonNode.get("userName").asText());
            record.put("timestamp", jsonNode.get("timestamp").asLong());
            
            return record;
        } catch (Exception e) {
            log.error("JSONè½¬Avroå¤±è´¥", e);
            throw new TransformException("æ¶ˆæ¯è½¬æ¢å¤±è´¥");
        }
    }
    
    // æ¶ˆæ¯æ ¼å¼æ ‡å‡†åŒ–
    public StandardMessage normalize(String rawMessage, String sourceFormat) {
        switch (sourceFormat) {
            case "JSON":
                return parseJsonMessage(rawMessage);
            case "XML":
                return parseXmlMessage(rawMessage);
            default:
                throw new UnsupportedFormatException("ä¸æ”¯æŒçš„æ ¼å¼: " + sourceFormat);
        }
    }
}
```

### 9.2 å†…å®¹å¢å¼ºæ¨¡å¼


**ç›®çš„**ï¼šåœ¨æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­æ·»åŠ é¢å¤–ä¿¡æ¯ã€‚

```java
@Service
public class MessageEnricher {
    
    @Autowired
    private UserService userService;
    
    // ä¸°å¯Œç”¨æˆ·æ¶ˆæ¯ï¼šæ·»åŠ ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
    public EnrichedUserEvent enrichUserEvent(UserEvent basicEvent) {
        // ä»æ•°æ®åº“è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
        UserProfile profile = userService.getUserProfile(basicEvent.getUserId());
        
        return EnrichedUserEvent.builder()
            .userId(basicEvent.getUserId())
            .eventType(basicEvent.getEventType())
            .timestamp(basicEvent.getTimestamp())
            // å¢å¼ºå­—æ®µ
            .userName(profile.getName())
            .userLevel(profile.getLevel())
            .registrationDate(profile.getRegistrationDate())
            .build();
    }
}
```

### 9.3 æ¶ˆæ¯èšåˆæ¨¡å¼


**åº”ç”¨åœºæ™¯**ï¼šå°†å¤šä¸ªç›¸å…³æ¶ˆæ¯åˆå¹¶æˆä¸€ä¸ªæ¶ˆæ¯ã€‚

```java
@Component
public class MessageAggregator {
    
    private final Map<String, List<OrderItem>> pendingOrders = new ConcurrentHashMap<>();
    
    // èšåˆè®¢å•é¡¹æ¶ˆæ¯
    public void aggregateOrderItems(OrderItemEvent itemEvent) {
        String orderId = itemEvent.getOrderId();
        
        // æ”¶é›†åŒä¸€è®¢å•çš„æ‰€æœ‰å•†å“é¡¹
        pendingOrders.computeIfAbsent(orderId, k -> new ArrayList<>())
                    .add(itemEvent.getOrderItem());
        
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å•†å“é¡¹éƒ½å·²æ”¶é›†å®Œæ¯•
        if (isOrderComplete(orderId)) {
            // å‘é€èšåˆåçš„å®Œæ•´è®¢å•æ¶ˆæ¯
            OrderCompletedEvent completedEvent = new OrderCompletedEvent(
                orderId, pendingOrders.remove(orderId)
            );
            kafkaTemplate.send("completed-orders", orderId, completedEvent);
        }
    }
}
```

---

## 10. ğŸ” é‡è¯•å’Œè¡¥å¿æ¨¡å¼


### 10.1 é‡è¯•æ¨¡å¼è®¾è®¡


**é‡è¯•å°±åƒæ‰“ç”µè¯æ²¡æ‰“é€šï¼Œè¿‡ä¸€ä¼šå„¿å†è¯•**ï¼š

```
é‡è¯•ç­–ç•¥ï¼š
ç¬¬1æ¬¡å¤±è´¥ â†’ ç­‰1ç§’ â†’ é‡è¯•
ç¬¬2æ¬¡å¤±è´¥ â†’ ç­‰2ç§’ â†’ é‡è¯•  
ç¬¬3æ¬¡å¤±è´¥ â†’ ç­‰4ç§’ â†’ é‡è¯•
ç¬¬4æ¬¡å¤±è´¥ â†’ ç­‰8ç§’ â†’ é‡è¯•
... æœ€å¤šé‡è¯•5æ¬¡
```

**ä»£ç å®ç°**ï¼š
```java
@Service
public class RetryableMessageProcessor {
    
    private static final int MAX_RETRIES = 5;
    
    @Retryable(
        value = {TransientException.class},
        maxAttempts = MAX_RETRIES,
        backoff = @Backoff(delay = 1000, multiplier = 2)
    )
    public void processMessage(String message) {
        try {
            // å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘
            businessService.handle(message);
        } catch (TransientException e) {
            log.warn("æ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œå°†é‡è¯•: {}", e.getMessage());
            throw e; // é‡æ–°æŠ›å‡ºï¼Œè§¦å‘é‡è¯•
        }
    }
    
    @Recover
    public void handleRetryExhausted(TransientException ex, String message) {
        log.error("æ¶ˆæ¯å¤„ç†é‡è¯•æ¬¡æ•°ç”¨å°½ï¼Œå‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—: {}", message);
        sendToDeadLetterQueue(message, ex);
    }
}
```

### 10.2 æ­»ä¿¡é˜Ÿåˆ—æ¨¡å¼


**å½“æ¶ˆæ¯å¤„ç†å¤šæ¬¡å¤±è´¥åï¼Œä¸èƒ½ä¸¢å¤±ï¼Œè¦æ”¾åˆ°"æ­»ä¿¡é˜Ÿåˆ—"**ï¼š

```
æ¶ˆæ¯å¤„ç†æµç¨‹ï¼š
æ­£å¸¸æ¶ˆæ¯ â†’ å¤„ç†æˆåŠŸ âœ…
     â†“
   å¤„ç†å¤±è´¥
     â†“
   é‡è¯•å¤„ç† â†’ æˆåŠŸ âœ…
     â†“
  é‡è¯•å¤±è´¥
     â†“
  æ­»ä¿¡é˜Ÿåˆ— â†’ äººå·¥å¤„ç†
```

```java
@Component
public class DeadLetterHandler {
    
    private final KafkaTemplate<String, String> kafkaTemplate;
    
    // å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—
    public void sendToDeadLetterQueue(String originalMessage, Exception error) {
        DeadLetterMessage dlqMessage = DeadLetterMessage.builder()
            .originalMessage(originalMessage)
            .errorMessage(error.getMessage())
            .failureTime(System.currentTimeMillis())
            .retryCount(MAX_RETRIES)
            .build();
            
        kafkaTemplate.send("dead-letter-queue", dlqMessage.toJson());
    }
    
    // ä»æ­»ä¿¡é˜Ÿåˆ—é‡æ–°å¤„ç†
    @KafkaListener(topics = "dead-letter-queue")
    public void handleDeadLetterMessages(String dlqMessage) {
        DeadLetterMessage message = DeadLetterMessage.fromJson(dlqMessage);
        
        log.info("å¤„ç†æ­»ä¿¡æ¶ˆæ¯ï¼ŒåŸæ¶ˆæ¯: {}", message.getOriginalMessage());
        
        // å¯ä»¥æ‰‹åŠ¨é‡æ–°å¤„ç†ï¼Œæˆ–è€…å‘é€å‘Šè­¦
        alertService.notifyDeadLetterMessage(message);
    }
}
```

### 10.3 è¡¥å¿æ¨¡å¼ï¼ˆSagaæ¨¡å¼ï¼‰


**è¡¥å¿æ¨¡å¼å°±åƒé“¶è¡Œè½¬è´¦ï¼Œå¦‚æœå¤±è´¥äº†è¦æ’¤é”€æ‰€æœ‰æ“ä½œ**ï¼š

```
æ­£å¸¸æµç¨‹ï¼š
æ­¥éª¤1ï¼šæ‰£å‡åº“å­˜ âœ…
æ­¥éª¤2ï¼šåˆ›å»ºè®¢å• âœ…  
æ­¥éª¤3ï¼šæ‰£å‡ä½™é¢ âœ…
æ­¥éª¤4ï¼šå‘é€å•†å“ âœ…

å¼‚å¸¸æƒ…å†µï¼ˆæ­¥éª¤3å¤±è´¥ï¼‰ï¼š
æ­¥éª¤1ï¼šæ‰£å‡åº“å­˜ âœ…
æ­¥éª¤2ï¼šåˆ›å»ºè®¢å• âœ…
æ­¥éª¤3ï¼šæ‰£å‡ä½™é¢ âŒ ï¼ˆä½™é¢ä¸è¶³ï¼‰

è¡¥å¿æ“ä½œï¼š
è¡¥å¿2ï¼šå–æ¶ˆè®¢å• âœ…
è¡¥å¿1ï¼šæ¢å¤åº“å­˜ âœ…
```

```java
@Service
public class OrderSagaOrchestrator {
    
    // è®¢å•å¤„ç†saga
    public void processOrder(OrderCreatedEvent event) {
        String sagaId = "saga-" + event.getOrderId();
        
        // æ­¥éª¤1ï¼šæ‰£å‡åº“å­˜
        inventoryService.reserve(event.getOrderId(), event.getItems())
            .thenCompose(success -> {
                if (success) {
                    // æ­¥éª¤2ï¼šåˆ›å»ºè®¢å•
                    return orderService.createOrder(event);
                } else {
                    throw new SagaException("åº“å­˜æ‰£å‡å¤±è´¥");
                }
            })
            .thenCompose(order -> {
                // æ­¥éª¤3ï¼šæ‰£å‡ä½™é¢
                return paymentService.charge(order.getCustomerId(), order.getAmount());
            })
            .exceptionally(throwable -> {
                log.error("è®¢å•å¤„ç†å¤±è´¥ï¼Œå¼€å§‹è¡¥å¿æ“ä½œ", throwable);
                // è§¦å‘è¡¥å¿æµç¨‹
                startCompensation(sagaId, event);
                return null;
            });
    }
    
    // è¡¥å¿æµç¨‹
    private void startCompensation(String sagaId, OrderCreatedEvent event) {
        // å‘é€è¡¥å¿æ¶ˆæ¯
        CompensationEvent compensation = CompensationEvent.builder()
            .sagaId(sagaId)
            .orderId(event.getOrderId())
            .compensationSteps(Arrays.asList(
                "CANCEL_ORDER", 
                "RESTORE_INVENTORY"
            ))
            .build();
            
        kafkaTemplate.send("compensation-events", sagaId, compensation);
    }
}
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¶ˆæ¯ç»“æ„è®¾è®¡ï¼šKey + Headers + Value ä¸‰å±‚ç»“æ„
ğŸ”¸ æ¶ˆæ¯å¤´è®¾è®¡ï¼šæ ‡å‡†åŒ–å¤´å­—æ®µï¼Œä¾¿äºè·¯ç”±å’Œå¤„ç†
ğŸ”¸ æ¶ˆæ¯ä½“è®¾è®¡ï¼šé€‰æ‹©åˆé€‚æ ¼å¼ï¼Œè€ƒè™‘å…¼å®¹æ€§
ğŸ”¸ æ¶ˆæ¯é”®è®¾è®¡ï¼šä¸šåŠ¡ç›¸å…³ï¼Œä¿è¯åˆ†åŒºå’Œé¡ºåº
ğŸ”¸ ç‰ˆæœ¬ç®¡ç†ï¼šå‘å‰å…¼å®¹ï¼Œæ”¯æŒç³»ç»Ÿæ¼”è¿›
ğŸ”¸ è·¯ç”±æ¨¡å¼ï¼šåŸºäºç±»å‹ã€å†…å®¹ã€å¤šæ’­è·¯ç”±
ğŸ”¸ è¿‡æ»¤æ¨¡å¼ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€åŸºäºå¤´éƒ¨è¿‡æ»¤
ğŸ”¸ è½¬æ¢æ¨¡å¼ï¼šæ ¼å¼è½¬æ¢ã€å†…å®¹å¢å¼ºã€æ¶ˆæ¯èšåˆ
ğŸ”¸ é‡è¯•è¡¥å¿ï¼šé‡è¯•æœºåˆ¶ã€æ­»ä¿¡é˜Ÿåˆ—ã€Sagaè¡¥å¿
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¶ˆæ¯è®¾è®¡çš„å¹³è¡¡è‰ºæœ¯**
```
ç®€å• vs åŠŸèƒ½ä¸°å¯Œï¼š
- æ¶ˆæ¯ç»“æ„è¦ç®€å•æ˜äº†ï¼Œä½†ä¹Ÿè¦åŒ…å«å¿…è¦ä¿¡æ¯
- ä¸è¦è¿‡åº¦è®¾è®¡ï¼Œä¹Ÿä¸è¦ä¿¡æ¯ä¸è¶³

æ€§èƒ½ vs å¯ç»´æŠ¤æ€§ï¼š  
- JSONæ ¼å¼æ˜“äºè°ƒè¯•ï¼Œä½†æ€§èƒ½ä¸å¦‚äºŒè¿›åˆ¶æ ¼å¼
- ç‰ˆæœ¬ç®¡ç†å¢åŠ å¤æ‚åº¦ï¼Œä½†æé«˜ç³»ç»Ÿå¯æ¼”è¿›æ€§

ä¸€è‡´æ€§ vs çµæ´»æ€§ï¼š
- ç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼ä¾¿äºå¤„ç†ï¼Œä½†é™åˆ¶äº†çµæ´»æ€§
- éœ€è¦åœ¨æ ‡å‡†åŒ–å’Œä¸ªæ€§åŒ–ä¹‹é—´æ‰¾å¹³è¡¡
```

**ğŸ”¹ æ¨¡å¼é€‰æ‹©çš„è€ƒè™‘å› ç´ **
```
ä¸šåŠ¡ç‰¹ç‚¹ï¼š
- äº‹åŠ¡æ€§ä¸šåŠ¡ â†’ éœ€è¦è¡¥å¿æ¨¡å¼
- é«˜ååä¸šåŠ¡ â†’ é‡è§†æ€§èƒ½ï¼Œé€‰æ‹©é«˜æ•ˆæ ¼å¼
- å¤šç§Ÿæˆ·ä¸šåŠ¡ â†’ éœ€è¦ç§Ÿæˆ·éš”ç¦»å’Œè·¯ç”±

æŠ€æœ¯çº¦æŸï¼š
- ç½‘ç»œå¸¦å®½æœ‰é™ â†’ é€‰æ‹©å‹ç¼©æ ¼å¼
- ç³»ç»Ÿå¼‚æ„ â†’ éœ€è¦æ¶ˆæ¯è½¬æ¢
- å¯ç”¨æ€§è¦æ±‚é«˜ â†’ éœ€è¦é‡è¯•å’Œå®¹é”™æœºåˆ¶
```

### 11.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ è®¾è®¡æ£€æŸ¥æ¸…å•**
```
æ¶ˆæ¯ç»“æ„æ£€æŸ¥ï¼š
âœ… æ˜¯å¦æœ‰å”¯ä¸€çš„æ¶ˆæ¯IDï¼Ÿ
âœ… æ˜¯å¦åŒ…å«æ¶ˆæ¯ç±»å‹ä¿¡æ¯ï¼Ÿ
âœ… æ˜¯å¦æœ‰æ—¶é—´æˆ³ä¿¡æ¯ï¼Ÿ
âœ… ä¸šåŠ¡æ•°æ®æ˜¯å¦å®Œæ•´ï¼Ÿ

å…¼å®¹æ€§æ£€æŸ¥ï¼š
âœ… æ–°å¢å­—æ®µæ˜¯å¦æœ‰é»˜è®¤å€¼ï¼Ÿ
âœ… æ˜¯å¦æ”¯æŒç‰ˆæœ¬æ ‡è¯†ï¼Ÿ
âœ… è€ç‰ˆæœ¬æ¶ˆè´¹è€…æ˜¯å¦èƒ½æ­£å¸¸å¤„ç†ï¼Ÿ

é”™è¯¯å¤„ç†æ£€æŸ¥ï¼š
âœ… æ˜¯å¦æœ‰é‡è¯•æœºåˆ¶ï¼Ÿ
âœ… æ˜¯å¦æœ‰æ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ
âœ… æ˜¯å¦æœ‰è¡¥å¿é€»è¾‘ï¼Ÿ
```

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**
```
å¼€å‘é˜¶æ®µï¼š
- å…ˆè®¾è®¡æ¶ˆæ¯Schemaï¼Œå†ç¼–å†™ä»£ç 
- ä½¿ç”¨ç»Ÿä¸€çš„æ¶ˆæ¯åŒ…è£…å™¨
- å»ºç«‹æ¶ˆæ¯æ ¼å¼è§„èŒƒæ–‡æ¡£

æµ‹è¯•é˜¶æ®µï¼š
- æµ‹è¯•ä¸åŒç‰ˆæœ¬æ¶ˆæ¯çš„å…¼å®¹æ€§
- æ¨¡æ‹Ÿå„ç§å¼‚å¸¸æƒ…å†µ
- éªŒè¯é‡è¯•å’Œè¡¥å¿é€»è¾‘

ç”Ÿäº§é˜¶æ®µï¼š
- ç›‘æ§æ¶ˆæ¯æ ¼å¼çš„ä½¿ç”¨æƒ…å†µ
- å®šæœŸæ¸…ç†æ­»ä¿¡é˜Ÿåˆ—
- å…³æ³¨æ¶ˆæ¯å¤„ç†çš„æ€§èƒ½æŒ‡æ ‡
```

### 11.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**ğŸ”§ é—®é¢˜æ’æŸ¥æŒ‡å—**
```
æ¶ˆæ¯æ— æ³•å¤„ç†ï¼š
1. æ£€æŸ¥æ¶ˆæ¯æ ¼å¼æ˜¯å¦æ­£ç¡®
2. éªŒè¯æ¶ˆè´¹è€…æ˜¯å¦æ”¯æŒè¯¥ç‰ˆæœ¬
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ç¡®å®šå…·ä½“åŸå› 

æ€§èƒ½é—®é¢˜ï¼š
1. æ¶ˆæ¯ä½“æ˜¯å¦è¿‡å¤§ï¼Ÿè€ƒè™‘å‹ç¼©
2. æ˜¯å¦æœ‰ä¸å¿…è¦çš„å­—æ®µï¼Ÿç²¾ç®€æ¶ˆæ¯
3. æ¶ˆæ¯é”®åˆ†å¸ƒæ˜¯å¦å‡åŒ€ï¼Ÿé¿å…çƒ­ç‚¹

æ•°æ®ä¸¢å¤±ï¼š
1. æ˜¯å¦æœ‰é‡è¯•æœºåˆ¶ï¼Ÿ
2. æ­»ä¿¡é˜Ÿåˆ—æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ
3. è¡¥å¿é€»è¾‘æ˜¯å¦å®Œæ•´ï¼Ÿ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ¶ˆæ¯è®¾è®¡è¦ç®€å•æ¸…æ™°ï¼Œæ ‡å‡†ç»Ÿä¸€
- ç‰ˆæœ¬ç®¡ç†ä¿è¯ç³»ç»Ÿå¯æ¼”è¿›
- è·¯ç”±è¿‡æ»¤æé«˜å¤„ç†æ•ˆç‡  
- é‡è¯•è¡¥å¿ä¿è¯æ•°æ®ä¸€è‡´æ€§
- å®è·µä¸­è¦å¹³è¡¡æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§