---
title: 10ã€Avroæ¶ˆè´¹è€…
---
## ğŸ“š ç›®å½•

1. [Avroæ¶ˆè´¹è€…åŸºç¡€æ¦‚å¿µ](#1-avroæ¶ˆè´¹è€…åŸºç¡€æ¦‚å¿µ)
2. [Schema Registryæ ¸å¿ƒç†è§£](#2-schema-registryæ ¸å¿ƒç†è§£)
3. [kafka-avro-console-consumerè¯¦è§£](#3-kafka-avro-console-consumerè¯¦è§£)
4. [ååºåˆ—åŒ–é…ç½®å®æˆ˜](#4-ååºåˆ—åŒ–é…ç½®å®æˆ˜)
5. [Schemaç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†](#5-schemaç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†)
6. [æ•°æ®æ ¼å¼åŒ–ä¸æ˜¾ç¤º](#6-æ•°æ®æ ¼å¼åŒ–ä¸æ˜¾ç¤º)
7. [é”™è¯¯å¤„ç†ä¸æ•…éšœæ’æŸ¥](#7-é”™è¯¯å¤„ç†ä¸æ•…éšœæ’æŸ¥)
8. [æ€§èƒ½ä¼˜åŒ–å®è·µ](#8-æ€§èƒ½ä¼˜åŒ–å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Avroæ¶ˆè´¹è€…åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Avroæ¶ˆè´¹è€…


> ğŸ’¡ **é€šä¿—ç†è§£**  
> æƒ³è±¡ä½ è¦é˜…è¯»ä¸€æœ¬å¤–è¯­ä¹¦ï¼Œæ™®é€šæ¶ˆè´¹è€…å°±åƒç›´æ¥çœ‹åŸæ–‡(å­—èŠ‚ç )ï¼Œè€ŒAvroæ¶ˆè´¹è€…å°±åƒæœ‰ä¸€ä¸ªä¸“ä¸šç¿»è¯‘(Schema)ï¼Œèƒ½æŠŠå†…å®¹ç¿»è¯‘æˆä½ èƒ½ç†è§£çš„æ ¼å¼ã€‚

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
Avroæ¶ˆè´¹è€… = æ™®é€šKafkaæ¶ˆè´¹è€… + Avroååºåˆ—åŒ–èƒ½åŠ›
ä½œç”¨ï¼šè¯»å–Avroæ ¼å¼çš„æ¶ˆæ¯å¹¶è½¬æ¢ä¸ºå¯è¯»æ ¼å¼
ä¼˜åŠ¿ï¼šç»“æ„åŒ–æ•°æ®ã€schemaè¿›åŒ–ã€å‹ç¼©æ•ˆç‡é«˜
```

**ğŸ” æ·±å…¥ç†è§£**
- **ç»“æ„åŒ–æ•°æ®**ï¼šä¸æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æœ‰æ˜ç¡®æ•°æ®ç»“æ„çš„å¯¹è±¡
- **Schemaçº¦æŸ**ï¼šæ•°æ®å¿…é¡»ç¬¦åˆé¢„å®šä¹‰çš„æ ¼å¼è§„èŒƒ
- **ç‰ˆæœ¬æ¼”è¿›**ï¼šæ”¯æŒæ•°æ®æ ¼å¼çš„å¹³æ»‘å‡çº§

### 1.2 ä¸ºä»€ä¹ˆé€‰æ‹©Avroæ ¼å¼


**ğŸ“Š Avro vs å…¶ä»–æ ¼å¼å¯¹æ¯”**

| æ ¼å¼ç±»å‹ | **å­˜å‚¨æ•ˆç‡** | **Schemaè¿›åŒ–** | **å¯è¯»æ€§** | **å¤„ç†é€Ÿåº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|---------------|-----------|-------------|-------------|
| ğŸ”¤ **JSON** | `ä½` | `å·®` | `æå¥½` | `ä¸­ç­‰` | `å¼€å‘æµ‹è¯•ã€å°æ•°æ®é‡` |
| ğŸ“‹ **Avro** | `é«˜` | `ä¼˜ç§€` | `éœ€å·¥å…·` | `å¿«` | `ç”Ÿäº§ç¯å¢ƒã€å¤§æ•°æ®é‡` |
| ğŸ—œï¸ **Protobuf** | `é«˜` | `å¥½` | `éœ€å·¥å…·` | `æå¿«` | `å¾®æœåŠ¡é—´é€šä¿¡` |

**ğŸ¯ é€‰æ‹©Avroçš„å…³é”®åœºæ™¯**
- æ•°æ®é‡å¤§ï¼Œéœ€è¦å‹ç¼©å­˜å‚¨
- æ•°æ®ç»“æ„å¯èƒ½å˜åŒ–ï¼Œéœ€è¦ç‰ˆæœ¬å…¼å®¹
- å¤šä¸ªç³»ç»Ÿé—´å…±äº«æ•°æ®æ ¼å¼

---

## 2. ğŸ—ï¸ Schema Registryæ ¸å¿ƒç†è§£


### 2.1 Schema Registryæ˜¯ä»€ä¹ˆ


> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> Schema Registryå°±åƒå›¾ä¹¦é¦†çš„åˆ†ç±»ç›®å½•ç³»ç»Ÿï¼Œå®ƒè®°å½•ç€æ¯ç§"ä¹¦ç±æ ¼å¼"(æ•°æ®ç»“æ„)çš„è¯¦ç»†è¯´æ˜ï¼Œè®©æ‰€æœ‰"è¯»è€…"(æ¶ˆè´¹è€…)éƒ½èƒ½æ­£ç¡®ç†è§£å†…å®¹ã€‚

**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
```
Schema Registryï¼šAvro schemaçš„ä¸­å¤®å­˜å‚¨å’Œç®¡ç†æœåŠ¡
åŠŸèƒ½ï¼š
â€¢ Schemaç‰ˆæœ¬ç®¡ç†
â€¢ å…¼å®¹æ€§æ£€æŸ¥  
â€¢ Schemaæ³¨å†Œä¸è·å–
â€¢ å®¢æˆ·ç«¯ç¼“å­˜ä¼˜åŒ–
```

### 2.2 å·¥ä½œåŸç†å›¾ç¤º


```
ç”Ÿäº§è€…å†™å…¥æµç¨‹ï¼š                    æ¶ˆè´¹è€…è¯»å–æµç¨‹ï¼š
     
ç”Ÿäº§è€…                              æ¶ˆè´¹è€…
   |                                   |
   |--[1]æ³¨å†Œ/è·å–Schema-->          æ¶ˆè´¹è€…
   |                     |             |
   |                 Schema        [4]è·å–Schema
   |                Registry           |
   |                     |             |
   |--[2]åºåˆ—åŒ–æ•°æ®--->[3]å†™å…¥æ¶ˆæ¯-->[5]ååºåˆ—åŒ–-->æœ€ç»ˆæ•°æ®
   |                                   |
 åŸå§‹æ•°æ®              Kafka Topic   å¯è¯»æ•°æ®

è¯´æ˜ï¼š
[1] ç”Ÿäº§è€…å‘Schema Registryæ³¨å†Œæˆ–è·å–Schema
[2] ä½¿ç”¨Schemaå°†åŸå§‹æ•°æ®åºåˆ—åŒ–ä¸ºAvroæ ¼å¼  
[3] å°†åºåˆ—åŒ–åçš„æ•°æ®å†™å…¥Kafka Topic
[4] æ¶ˆè´¹è€…ä»Schema Registryè·å–ç›¸åŒçš„Schema
[5] ä½¿ç”¨Schemaå°†Avroæ•°æ®ååºåˆ—åŒ–ä¸ºåŸå§‹æ ¼å¼
```

### 2.3 Schema Registryè¿æ¥é…ç½®


**ğŸ”§ åŸºç¡€è¿æ¥å‚æ•°**
```bash
# Schema RegistryæœåŠ¡åœ°å€
--property schema.registry.url=http://localhost:8081

# å¤šä¸ªSchema Registry(é«˜å¯ç”¨)
--property schema.registry.url=http://sr1:8081,http://sr2:8081,http://sr3:8081
```

> âš ï¸ **é‡è¦æé†’**  
> Schema Registryçš„åœ°å€å¿…é¡»æ­£ç¡®ï¼Œå¦åˆ™æ¶ˆè´¹è€…æ— æ³•è·å–schemaï¼Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥

---

## 3. âš¡ kafka-avro-console-consumerè¯¦è§£


### 3.1 åŸºç¡€å‘½ä»¤æ ¼å¼


**ğŸ”¸ å‘½ä»¤ç»“æ„**
```bash
kafka-avro-console-consumer \
  --bootstrap-server <kafkaåœ°å€> \
  --topic <ä¸»é¢˜å> \
  --property schema.registry.url=<schemaæ³¨å†Œä¸­å¿ƒåœ°å€> \
  [å…¶ä»–å¯é€‰å‚æ•°]
```

### 3.2 æ ¸å¿ƒå¿…çŸ¥å¿…ä¼šå‘½ä»¤


**ğŸ“Œ æœ€ç®€å•çš„æ¶ˆè´¹å‘½ä»¤**
```bash
# æ¶ˆè´¹Avroæ ¼å¼çš„æ¶ˆæ¯
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --from-beginning
```

**ğŸ“Œ æŒ‡å®šæ¶ˆè´¹è€…ç»„**
```bash
# åŠ å…¥ç‰¹å®šæ¶ˆè´¹è€…ç»„
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --group avro-test-group \
  --property schema.registry.url=http://localhost:8081
```

**ğŸ“Œ æŒ‡å®šåˆ†åŒºå’Œåç§»é‡**
```bash
# ä»ç‰¹å®šåˆ†åŒºçš„ç‰¹å®šä½ç½®å¼€å§‹æ¶ˆè´¹
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --partition 0 \
  --offset 100 \
  --property schema.registry.url=http://localhost:8081
```

### 3.3 é«˜çº§æ¶ˆè´¹é…ç½®


**ğŸ” è¯¦ç»†é…ç½®ç¤ºä¾‹**
```bash
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --group detailed-consumer-group \
  --property schema.registry.url=http://localhost:8081 \
  --property print.key=true \
  --property print.headers=true \
  --property print.timestamp=true \
  --property print.partition=true \
  --property print.offset=true \
  --max-messages 1000 \
  --timeout-ms 10000
```

**ğŸ”¸ å‚æ•°è¯¦è§£**
- `print.key=true`ï¼šæ˜¾ç¤ºæ¶ˆæ¯çš„key
- `print.headers=true`ï¼šæ˜¾ç¤ºæ¶ˆæ¯å¤´ä¿¡æ¯
- `print.timestamp=true`ï¼šæ˜¾ç¤ºæ¶ˆæ¯æ—¶é—´æˆ³
- `print.partition=true`ï¼šæ˜¾ç¤ºåˆ†åŒºä¿¡æ¯
- `print.offset=true`ï¼šæ˜¾ç¤ºåç§»é‡
- `max-messages=1000`ï¼šæœ€å¤šæ¶ˆè´¹1000æ¡æ¶ˆæ¯ååœæ­¢
- `timeout-ms=10000`ï¼š10ç§’æ²¡æœ‰æ–°æ¶ˆæ¯åˆ™é€€å‡º

---

## 4. ğŸ”„ ååºåˆ—åŒ–é…ç½®å®æˆ˜


### 4.1 Avroååºåˆ—åŒ–æ ¸å¿ƒåŸç†


> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> ååºåˆ—åŒ–å°±åƒ"è§£å¯†"è¿‡ç¨‹ï¼Œéœ€è¦æœ‰æ­£ç¡®çš„"å¯†é’¥"(Schema)æ‰èƒ½æŠŠäºŒè¿›åˆ¶æ•°æ®è¿˜åŸæˆåŸå§‹æ ¼å¼ã€‚

**ğŸ”¸ ååºåˆ—åŒ–æµç¨‹**
```
äºŒè¿›åˆ¶Avroæ•°æ® â†’ Schemaè§£æ â†’ ç»“æ„åŒ–å¯¹è±¡ â†’ JSONæ ¼å¼æ˜¾ç¤º

å…·ä½“æ­¥éª¤ï¼š
1. ä»æ¶ˆæ¯å¤´è¯»å–Schema ID
2. æ ¹æ®Schema IDä»Registryè·å–Schema
3. ä½¿ç”¨Schemaè§£æäºŒè¿›åˆ¶æ•°æ®
4. è½¬æ¢ä¸ºå¯è¯»çš„JSONæ ¼å¼è¾“å‡º
```

### 4.2 ååºåˆ—åŒ–å™¨é…ç½®


**ğŸ”§ å…³é”®é…ç½®å‚æ•°**
```bash
# æŒ‡å®šKeyçš„ååºåˆ—åŒ–å™¨(å¦‚æœKeyä¹Ÿæ˜¯Avroæ ¼å¼)
--property key.deserializer=io.confluent.kafka.serializers.KafkaAvroDeserializer

# æŒ‡å®šValueçš„ååºåˆ—åŒ–å™¨
--property value.deserializer=io.confluent.kafka.serializers.KafkaAvroDeserializer

# Schema Registryè®¤è¯(å¦‚æœå¯ç”¨äº†å®‰å…¨è®¤è¯)
--property schema.registry.basic.auth.credentials.source=USER_INFO
--property schema.registry.basic.auth.user.info=username:password
```

### 4.3 å¸¸è§ååºåˆ—åŒ–é—®é¢˜å¤„ç†


**âŒ é—®é¢˜1ï¼šSchemaä¸åŒ¹é…**
```bash
# é”™è¯¯ä¿¡æ¯ç¤ºä¾‹
Error: Unknown magic byte! 

# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ•°æ®æ˜¯å¦çœŸçš„æ˜¯Avroæ ¼å¼
kafka-console-consumer --bootstrap-server localhost:9092 --topic user-events --from-beginning
# å¦‚æœèƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œè¯´æ˜ä¸æ˜¯Avroæ ¼å¼ï¼Œåº”è¯¥ç”¨æ™®é€šæ¶ˆè´¹è€…
```

**âŒ é—®é¢˜2ï¼šSchema Registryè¿æ¥å¤±è´¥**
```bash
# é”™è¯¯ä¿¡æ¯ç¤ºä¾‹
Failed to fetch schema from registry

# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥Schema Registryåœ°å€å’ŒæœåŠ¡çŠ¶æ€
curl http://localhost:8081/subjects  # æµ‹è¯•è¿é€šæ€§
```

---

## 5. ğŸ“‹ Schemaç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†


### 5.1 Schemaæ¼”è¿›åŸºç¡€æ¦‚å¿µ


> ğŸ’¡ **é€šä¿—ç†è§£**  
> Schemaç‰ˆæœ¬å°±åƒè½¯ä»¶ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬è¦èƒ½å¤„ç†æ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¿™å«"å‘åå…¼å®¹"ï¼›æ—§ç‰ˆæœ¬èƒ½ç†è§£æ–°ç‰ˆæœ¬æ•°æ®ï¼Œè¿™å«"å‘å‰å…¼å®¹"ã€‚

**ğŸ”¸ å…¼å®¹æ€§ç±»å‹**
```
å‘åå…¼å®¹(BACKWARD)ï¼šæ–°Schemaèƒ½è¯»å–æ—§æ•°æ®
å‘å‰å…¼å®¹(FORWARD)ï¼šæ—§Schemaèƒ½è¯»å–æ–°æ•°æ®  
å®Œå…¨å…¼å®¹(FULL)ï¼šåŒå‘å…¼å®¹
æ— å…¼å®¹(NONE)ï¼šä¸åšå…¼å®¹æ€§æ£€æŸ¥
```

### 5.2 ç‰ˆæœ¬å…¼å®¹æ€§å®è·µ


**ğŸ“Š Schemaæ¼”è¿›ç¤ºä¾‹**

**ç‰ˆæœ¬1 - åŸå§‹Schemaï¼š**
```json
{
  "type": "record",
  "name": "User",
  "fields": [
    {"name": "id", "type": "int"},
    {"name": "name", "type": "string"}
  ]
}
```

**ç‰ˆæœ¬2 - æ·»åŠ å¯é€‰å­—æ®µ(å‘åå…¼å®¹)ï¼š**
```json
{
  "type": "record", 
  "name": "User",
  "fields": [
    {"name": "id", "type": "int"},
    {"name": "name", "type": "string"},
    {"name": "email", "type": ["null", "string"], "default": null}
  ]
}
```

**ğŸ”¸ å…¼å®¹æ€§æ£€æŸ¥å‘½ä»¤**
```bash
# æŸ¥çœ‹ä¸»é¢˜çš„Schemaç‰ˆæœ¬
curl http://localhost:8081/subjects/user-events-value/versions

# æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬çš„Schema
curl http://localhost:8081/subjects/user-events-value/versions/1

# æµ‹è¯•Schemaå…¼å®¹æ€§
curl -X POST http://localhost:8081/compatibility/subjects/user-events-value/versions/latest \
  -H "Content-Type: application/vnd.schemaregistry.v1+json" \
  -d '{"schema": "æ–°çš„schemaå†…å®¹"}'
```

### 5.3 ç‰ˆæœ¬æŒ‡å®šæ¶ˆè´¹


**ğŸ”§ æ¶ˆè´¹ç‰¹å®šSchemaç‰ˆæœ¬**
```bash
# å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„Schema
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --property use.latest.version=false \
  --property specific.avro.reader=true
```

---

## 6. ğŸ“„ æ•°æ®æ ¼å¼åŒ–ä¸æ˜¾ç¤º


### 6.1 è¾“å‡ºæ ¼å¼æ§åˆ¶


**ğŸ”¸ åŸºç¡€æ˜¾ç¤ºæ ¼å¼**
```bash
# é»˜è®¤JSONæ ¼å¼è¾“å‡º
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --from-beginning
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```json
{"id": 1001, "name": "å¼ ä¸‰", "email": "zhangsan@email.com"}
{"id": 1002, "name": "æå››", "email": null}
```

### 6.2 ä¸°å¯Œçš„æ˜¾ç¤ºé€‰é¡¹


**ğŸ”§ å®Œæ•´ä¿¡æ¯æ˜¾ç¤º**
```bash
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --property print.key=true \
  --property print.timestamp=true \
  --property print.partition=true \
  --property print.offset=true \
  --property key.separator=" | " \
  --property line.separator="\n---\n"
```

**ä¸°å¯Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
Partition:0 Offset:100 Timestamp:1695123456789
Key: user_1001 | Value: {"id": 1001, "name": "å¼ ä¸‰"}
---
Partition:0 Offset:101 Timestamp:1695123456790  
Key: user_1002 | Value: {"id": 1002, "name": "æå››"}
---
```

### 6.3 è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨


**ğŸ¨ JSONç¾åŒ–æ˜¾ç¤º**
```bash
# é…åˆjqå·¥å…·ç¾åŒ–JSONè¾“å‡º
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --max-messages 10 | jq '.'
```

**ç¾åŒ–åçš„è¾“å‡ºï¼š**
```json
{
  "id": 1001,
  "name": "å¼ ä¸‰", 
  "email": "zhangsan@email.com",
  "created_at": "2023-09-20T10:30:45Z"
}
```

---

## 7. âš ï¸ é”™è¯¯å¤„ç†ä¸æ•…éšœæ’æŸ¥


### 7.1 å¸¸è§é”™è¯¯ç±»å‹


**âŒ é”™è¯¯1ï¼šSchema Registryè¿æ¥é—®é¢˜**
```bash
# é”™è¯¯ä¿¡æ¯
org.apache.kafka.common.errors.SerializationException: Error retrieving Avro schema

# æ’æŸ¥æ­¥éª¤
1. æ£€æŸ¥Schema RegistryæœåŠ¡çŠ¶æ€
curl http://localhost:8081/subjects

2. æ£€æŸ¥ç½‘ç»œè¿æ¥
telnet localhost 8081

3. æ£€æŸ¥é…ç½®å‚æ•°
--property schema.registry.url=http://localhost:8081  # ç¡®ä¿åœ°å€æ­£ç¡®
```

**âŒ é”™è¯¯2ï¼šSchemaä¸å­˜åœ¨**
```bash
# é”™è¯¯ä¿¡æ¯  
Subject 'user-events-value' not found

# è§£å†³æ–¹æ¡ˆ
1. ç¡®è®¤Topicä¸­ç¡®å®æœ‰Avroæ•°æ®
2. æ£€æŸ¥Schemaæ˜¯å¦å·²æ³¨å†Œ
curl http://localhost:8081/subjects/user-events-value/versions

3. å°è¯•å…ˆç”Ÿäº§ä¸€æ¡Avroæ¶ˆæ¯ä»¥æ³¨å†ŒSchema
```

**âŒ é”™è¯¯3ï¼šæ•°æ®æ ¼å¼ä¸åŒ¹é…**
```bash
# é”™è¯¯ä¿¡æ¯
Unknown magic byte!

# åŸå› åˆ†æ
æ¶ˆæ¯ä¸æ˜¯Avroæ ¼å¼ï¼Œå¯èƒ½æ˜¯ï¼š
- æ™®é€šæ–‡æœ¬æ¶ˆæ¯
- JSONæ ¼å¼æ¶ˆæ¯  
- å…¶ä»–åºåˆ—åŒ–æ ¼å¼

# è§£å†³æ–¹æ¡ˆ
å…ˆç”¨æ™®é€šæ¶ˆè´¹è€…æ£€æŸ¥æ•°æ®æ ¼å¼ï¼š
kafka-console-consumer --bootstrap-server localhost:9092 --topic user-events --from-beginning
```

### 7.2 è°ƒè¯•æŠ€å·§


**ğŸ” è°ƒè¯•æ¨¡å¼å¯ç”¨**
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export KAFKA_OPTS="-Dlog4j.logger.io.confluent=DEBUG"

kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081
```

**ğŸ”§ é€æ­¥æ’æŸ¥æ³•**
```bash
# æ­¥éª¤1ï¼šæ£€æŸ¥æ™®é€šæ¶ˆè´¹æ˜¯å¦æ­£å¸¸
kafka-console-consumer --bootstrap-server localhost:9092 --topic user-events --max-messages 1

# æ­¥éª¤2ï¼šæ£€æŸ¥Schema Registryè¿é€šæ€§
curl http://localhost:8081/subjects

# æ­¥éª¤3ï¼šæ£€æŸ¥ä¸»é¢˜çš„Schema
curl http://localhost:8081/subjects/user-events-value/versions/latest

# æ­¥éª¤4ï¼šå°è¯•Avroæ¶ˆè´¹
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --max-messages 1
```

---

## 8. ğŸš€ æ€§èƒ½ä¼˜åŒ–å®è·µ


### 8.1 Schemaç¼“å­˜ä¼˜åŒ–


> ğŸ’¡ **æ€§èƒ½å…³é”®ç‚¹**  
> Schemaè·å–æ˜¯ç½‘ç»œæ“ä½œï¼Œé¢‘ç¹è·å–ä¼šå½±å“æ€§èƒ½ã€‚å¯ç”¨ç¼“å­˜å¯ä»¥æ˜¾è‘—æå‡æ¶ˆè´¹é€Ÿåº¦ã€‚

**ğŸ”§ ç¼“å­˜é…ç½®å‚æ•°**
```bash
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --property schema.registry.cache.capacity=1000 \
  --property auto.register.schemas=false \
  --property use.latest.version=true
```

**ğŸ”¸ ç¼“å­˜å‚æ•°è¯´æ˜**
- `schema.registry.cache.capacity=1000`ï¼šç¼“å­˜1000ä¸ªSchema
- `auto.register.schemas=false`ï¼šä¸è‡ªåŠ¨æ³¨å†ŒSchema(æ¶ˆè´¹è€…é€šå¸¸ä¸éœ€è¦)
- `use.latest.version=true`ï¼šæ€»æ˜¯ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬Schema

### 8.2 æ‰¹é‡æ¶ˆè´¹ä¼˜åŒ–


**âš¡ æ‰¹é‡å¤„ç†é…ç½®**
```bash
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --property fetch.min.bytes=1048576 \
  --property fetch.max.wait.ms=500 \
  --property max.poll.records=1000
```

**ğŸ”¸ æ€§èƒ½å‚æ•°è§£é‡Š**
- `fetch.min.bytes=1048576`ï¼šæœ€å°‘è·å–1MBæ•°æ®æ‰è¿”å›
- `fetch.max.wait.ms=500`ï¼šæœ€å¤šç­‰å¾…500ms
- `max.poll.records=1000`ï¼šæ¯æ¬¡pollæœ€å¤š1000æ¡è®°å½•

### 8.3 å†…å­˜ä¼˜åŒ–é…ç½®


**ğŸ§  JVMå†…å­˜è°ƒä¼˜**
```bash
# è®¾ç½®JVMå†…å­˜å‚æ•°
export KAFKA_HEAP_OPTS="-Xmx2G -Xms2G"
export KAFKA_JVM_PERFORMANCE_OPTS="-XX:+UseG1GC -XX:MaxGCPauseMillis=20"

kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081
```

### 8.4 ç½‘ç»œä¼˜åŒ–é…ç½®


**ğŸŒ ç½‘ç»œå‚æ•°è°ƒä¼˜**
```bash
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --property connections.max.idle.ms=540000 \
  --property request.timeout.ms=30000 \
  --property retry.backoff.ms=100
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Avroæ¶ˆè´¹è€…ï¼šä¸“é—¨å¤„ç†Avroæ ¼å¼æ•°æ®çš„æ¶ˆè´¹è€…å·¥å…·
ğŸ”¸ Schema Registryï¼šç®¡ç†å’Œå­˜å‚¨Avro Schemaçš„ä¸­å¤®æœåŠ¡
ğŸ”¸ ååºåˆ—åŒ–ï¼šå°†äºŒè¿›åˆ¶Avroæ•°æ®è½¬æ¢ä¸ºå¯è¯»æ ¼å¼çš„è¿‡ç¨‹
ğŸ”¸ Schemaç‰ˆæœ¬ï¼šæ”¯æŒæ•°æ®æ ¼å¼æ¼”è¿›çš„ç‰ˆæœ¬ç®¡ç†æœºåˆ¶
ğŸ”¸ å…¼å®¹æ€§ï¼šæ–°æ—§Schemaç‰ˆæœ¬é—´çš„æ•°æ®äº’é€šèƒ½åŠ›
```

### 9.2 å…³é”®å‘½ä»¤é€ŸæŸ¥


**ğŸ¯ æ ¸å¿ƒå‘½ä»¤æ¨¡æ¿**
```bash
# åŸºç¡€æ¶ˆè´¹å‘½ä»¤
kafka-avro-console-consumer \
  --bootstrap-server <kafkaåœ°å€> \
  --topic <ä¸»é¢˜å> \
  --property schema.registry.url=<æ³¨å†Œä¸­å¿ƒåœ°å€>

# å®Œæ•´ä¿¡æ¯æ˜¾ç¤º
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --property print.key=true \
  --property print.timestamp=true \
  --from-beginning

# æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬  
kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-events \
  --property schema.registry.url=http://localhost:8081 \
  --property schema.registry.cache.capacity=1000 \
  --property fetch.min.bytes=1048576
```

### 9.3 æ•…éšœæ’æŸ¥æ£€æŸ¥æ¸…å•


```
âœ… æ£€æŸ¥é¡¹ç›®æ¸…å•ï¼š
â–¡ Schema RegistryæœåŠ¡æ˜¯å¦è¿è¡Œæ­£å¸¸ï¼Ÿ
â–¡ ç½‘ç»œè¿æ¥æ˜¯å¦ç•…é€šï¼Ÿ 
â–¡ Topicä¸­çš„æ•°æ®ç¡®å®æ˜¯Avroæ ¼å¼å—ï¼Ÿ
â–¡ Schemaæ˜¯å¦å·²æ­£ç¡®æ³¨å†Œï¼Ÿ
â–¡ é…ç½®å‚æ•°æ˜¯å¦æ­£ç¡®ï¼Ÿ
â–¡ JVMå†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Ÿ
```

### 9.4 æœ€ä½³å®è·µå»ºè®®


**ğŸŒŸ ç”Ÿäº§ç¯å¢ƒå»ºè®®**
- å¯ç”¨Schemaç¼“å­˜æå‡æ€§èƒ½
- é…ç½®åˆé€‚çš„æ¶ˆè´¹è€…ç»„é¿å…é‡å¤æ¶ˆè´¹
- ä½¿ç”¨å…¼å®¹çš„Schemaç‰ˆæœ¬ç­–ç•¥
- ç›‘æ§æ¶ˆè´¹lagå’Œé”™è¯¯ç‡
- è®¾ç½®åˆç†çš„è¶…æ—¶å’Œé‡è¯•å‚æ•°

**ğŸ§  æ ¸å¿ƒè®°å¿†**
- **Avroæ¶ˆè´¹æ ¸å¿ƒ**ï¼šSchema Registry + ååºåˆ—åŒ–é…ç½®
- **æ€§èƒ½å…³é”®**ï¼šç¼“å­˜Schema + æ‰¹é‡æ¶ˆè´¹
- **æ•…éšœæ’æŸ¥**ï¼šå…ˆæ£€æŸ¥è¿é€šæ€§ï¼Œå†éªŒè¯æ•°æ®æ ¼å¼
- **ç‰ˆæœ¬ç®¡ç†**ï¼šå‘åå…¼å®¹ä¿è¯å¹³æ»‘å‡çº§

**å®è·µä»·å€¼**ï¼š
- é«˜æ•ˆå¤„ç†ç»“æ„åŒ–æ•°æ®æµ
- æ”¯æŒæ•°æ®æ ¼å¼æ¼”è¿›
- å®ç°ç³»ç»Ÿé—´æ ‡å‡†åŒ–æ•°æ®äº¤æ¢
- æä¾›ä¼ä¸šçº§æ•°æ®è´¨é‡ä¿è¯