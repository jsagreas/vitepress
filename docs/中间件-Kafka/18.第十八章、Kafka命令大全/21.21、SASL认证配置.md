---
title: 21ã€SASLè®¤è¯é…ç½®
---
## ğŸ“š ç›®å½•

1. [SASLè®¤è¯åŸºç¡€æ¦‚å¿µ](#1-SASLè®¤è¯åŸºç¡€æ¦‚å¿µ)
2. [PLAINè®¤è¯æœºåˆ¶](#2-PLAINè®¤è¯æœºåˆ¶)
3. [SCRAMè®¤è¯é…ç½®](#3-SCRAMè®¤è¯é…ç½®)
4. [Kerberosè®¤è¯é›†æˆ](#4-Kerberosè®¤è¯é›†æˆ)
5. [ç”¨æˆ·å‡­æ®ç®¡ç†](#5-ç”¨æˆ·å‡­æ®ç®¡ç†)
6. [è®¤è¯æµ‹è¯•éªŒè¯](#6-è®¤è¯æµ‹è¯•éªŒè¯)
7. [æƒé™æ˜ å°„é…ç½®](#7-æƒé™æ˜ å°„é…ç½®)
8. [å¸¸è§é—®é¢˜æ’æŸ¥](#8-å¸¸è§é—®é¢˜æ’æŸ¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” SASLè®¤è¯åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SASLè®¤è¯


**SASLç®€å•ç†è§£**ï¼šSASLå°±åƒæ˜¯Kafkaçš„"é—¨å«ç³»ç»Ÿ"ï¼Œè´Ÿè´£éªŒè¯è°å¯ä»¥è¿›å…¥Kafkaé›†ç¾¤

```
æ²¡æœ‰è®¤è¯çš„Kafkaï¼š
ä»»ä½•äºº âœ ç›´æ¥è¿æ¥ âœ è¯»å†™æ•°æ® âŒ ä¸å®‰å…¨ï¼

æœ‰SASLè®¤è¯çš„Kafkaï¼š
ç”¨æˆ· âœ æä¾›ç”¨æˆ·åå¯†ç  âœ éªŒè¯é€šè¿‡ âœ å…è®¸è¿æ¥ âœ… å®‰å…¨ï¼
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”’ **èº«ä»½éªŒè¯**ï¼šç¡®è®¤è¿æ¥è€…çš„èº«ä»½
- ğŸ›¡ï¸ **è®¿é—®æ§åˆ¶**ï¼šæ§åˆ¶è°èƒ½è®¿é—®ä»€ä¹ˆèµ„æº
- ğŸ“ **æ“ä½œå®¡è®¡**ï¼šè®°å½•è°åšäº†ä»€ä¹ˆæ“ä½œ

### 1.2 SASLè®¤è¯æœºåˆ¶å¯¹æ¯”


| è®¤è¯æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **å®‰å…¨çº§åˆ«** | **é…ç½®å¤æ‚åº¦** | **æ€§èƒ½å½±å“** |
|---------|------------|------------|--------------|------------|
| ğŸ”¤ **PLAIN** | `å¼€å‘æµ‹è¯•ç¯å¢ƒ` | `ä½` | `ç®€å•` | `å¾ˆå°` |
| ğŸ” **SCRAM** | `ç”Ÿäº§ç¯å¢ƒ` | `é«˜` | `ä¸­ç­‰` | `å°` |
| ğŸ« **GSSAPI** | `ä¼ä¸šç¯å¢ƒ` | `å¾ˆé«˜` | `å¤æ‚` | `ä¸­ç­‰` |

### 1.3 å®‰å…¨åè®®é€‰æ‹©


**åè®®ç»„åˆè¯´æ˜**ï¼š
```
SASL_PLAINTEXTï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ˜æ–‡ä¼ è¾“    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   Kafka     â”‚
â”‚ (ç”¨æˆ·åå¯†ç ) â”‚    SASLè®¤è¯   â”‚   æœåŠ¡å™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é€‚ç”¨ï¼šå†…ç½‘ç¯å¢ƒï¼Œæ€§èƒ½è¦æ±‚é«˜

SASL_SSLï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   åŠ å¯†ä¼ è¾“    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯     â”‚ â•â•â•â•â•â•â•â•â•â•â•â†’ â”‚   Kafka     â”‚
â”‚ (ç”¨æˆ·åå¯†ç ) â”‚  SASL+SSLè®¤è¯ â”‚   æœåŠ¡å™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é€‚ç”¨ï¼šç”Ÿäº§ç¯å¢ƒï¼Œå®‰å…¨è¦æ±‚é«˜
```

---

## 2. ğŸ”¤ PLAINè®¤è¯æœºåˆ¶


### 2.1 PLAINè®¤è¯åŸç†


**å·¥ä½œåŸç†ç®€å•è§£é‡Š**ï¼š
PLAINè®¤è¯å°±åƒæ˜¯æœ€ç®€å•çš„ç”¨æˆ·åå¯†ç ç™»å½•ï¼Œç”¨æˆ·æä¾›è´¦å·å¯†ç ï¼ŒKafkaéªŒè¯æ˜¯å¦æ­£ç¡®ã€‚

```
è®¤è¯æµç¨‹ï¼š
å®¢æˆ·ç«¯                          KafkaæœåŠ¡å™¨
   â”‚                              â”‚
   â”‚ â”€â”€â‘  å‘èµ·è¿æ¥è¯·æ±‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
   â”‚                              â”‚
   â”‚ â†â”€â‘¡ è¦æ±‚SASLè®¤è¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                              â”‚
   â”‚ â”€â”€â‘¢ å‘é€ç”¨æˆ·åå¯†ç â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
   â”‚                              â”‚
   â”‚ â†â”€â‘£ éªŒè¯ç»“æœ(æˆåŠŸ/å¤±è´¥)â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                              â”‚
   â”‚ â”€â”€â‘¤ å¼€å§‹æ­£å¸¸é€šä¿¡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
```

### 2.2 æœåŠ¡å™¨ç«¯PLAINé…ç½®


**2.2.1 server.propertiesé…ç½®**

```properties
# å¯ç”¨SASLè®¤è¯
listeners=SASL_PLAINTEXT://0.0.0.0:9092
security.inter.broker.protocol=SASL_PLAINTEXT
sasl.mechanism.inter.broker.protocol=PLAIN
sasl.enabled.mechanisms=PLAIN

# æŒ‡å®šè®¤è¯é…ç½®æ–‡ä»¶ä½ç½®
listener.name.sasl_plaintext.plain.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required \
    username="admin" \
    password="admin-password" \
    user_admin="admin-password" \
    user_alice="alice-password" \
    user_bob="bob-password";
```

**é…ç½®è¯´æ˜**ï¼š
- `listeners`ï¼šç›‘å¬åœ°å€ï¼Œä½¿ç”¨SASL_PLAINTEXTåè®®
- `user_xxx`ï¼šå®šä¹‰ç”¨æˆ·è´¦å·ï¼Œæ ¼å¼ä¸º `user_ç”¨æˆ·å="å¯†ç "`
- `username/password`ï¼šbrokeré—´é€šä¿¡ä½¿ç”¨çš„è´¦å·

**2.2.2 ç‹¬ç«‹JAASé…ç½®æ–‡ä»¶æ–¹å¼**

åˆ›å»º `kafka_server_jaas.conf` æ–‡ä»¶ï¼š
```
KafkaServer {
    org.apache.kafka.common.security.plain.PlainLoginModule required
    username="admin"
    password="admin-password"
    user_admin="admin-password"
    user_alice="alice-password"
    user_bob="bob-password";
};
```

å¯åŠ¨Kafkaæ—¶æŒ‡å®šé…ç½®æ–‡ä»¶ï¼š
```bash
export KAFKA_OPTS="-Djava.security.auth.login.config=/path/to/kafka_server_jaas.conf"
bin/kafka-server-start.sh config/server.properties
```

### 2.3 å®¢æˆ·ç«¯PLAINé…ç½®


**2.3.1 å‘½ä»¤è¡Œå·¥å…·é…ç½®**

åˆ›å»ºå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ `client.properties`ï¼š
```properties
security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required \
    username="alice" \
    password="alice-password";
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºtopicï¼ˆéœ€è¦adminæƒé™ï¼‰
kafka-topics.sh --bootstrap-server localhost:9092 \
    --command-config client.properties \
    --create --topic test-topic --partitions 3 --replication-factor 1

# ç”Ÿäº§æ¶ˆæ¯
echo "Hello Kafka" | kafka-console-producer.sh \
    --bootstrap-server localhost:9092 \
    --topic test-topic \
    --producer.config client.properties

# æ¶ˆè´¹æ¶ˆæ¯
kafka-console-consumer.sh \
    --bootstrap-server localhost:9092 \
    --topic test-topic \
    --consumer.config client.properties \
    --from-beginning
```

### 2.4 Javaå®¢æˆ·ç«¯PLAINé…ç½®


```java
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("security.protocol", "SASL_PLAINTEXT");
props.put("sasl.mechanism", "PLAIN");
props.put("sasl.jaas.config", 
    "org.apache.kafka.common.security.plain.PlainLoginModule required " +
    "username=\"alice\" " +
    "password=\"alice-password\";");

// Produceré…ç½®
props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");

KafkaProducer<String, String> producer = new KafkaProducer<>(props);
```

---

## 3. ğŸ” SCRAMè®¤è¯é…ç½®


### 3.1 SCRAMè®¤è¯åŸç†


**SCRAMæ˜¯ä»€ä¹ˆ**ï¼šSCRAMæ˜¯"æŒ‘æˆ˜-å“åº”"è®¤è¯æœºåˆ¶ï¼Œæ¯”PLAINæ›´å®‰å…¨ï¼Œå¯†ç ä¸ä¼šæ˜æ–‡ä¼ è¾“ã€‚

```
SCRAMè®¤è¯è¿‡ç¨‹ï¼ˆç®€åŒ–ï¼‰ï¼š
å®¢æˆ·ç«¯                          KafkaæœåŠ¡å™¨
   â”‚                              â”‚
   â”‚ â”€â”€â‘  è¯·æ±‚è®¤è¯(ç”¨æˆ·å)â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
   â”‚                              â”‚
   â”‚ â†â”€â‘¡ å‘é€æŒ‘æˆ˜(éšæœºæ•°)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                              â”‚
   â”‚ â”€â”€â‘¢ å“åº”æŒ‘æˆ˜(è®¡ç®—ç»“æœ)â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
   â”‚     (åŸºäºå¯†ç +éšæœºæ•°è®¡ç®—)        â”‚
   â”‚                              â”‚
   â”‚ â†â”€â‘£ éªŒè¯æˆåŠŸâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

**å®‰å…¨ä¼˜åŠ¿**ï¼š
- ğŸ”’ å¯†ç ä¸æ˜æ–‡ä¼ è¾“
- ğŸ›¡ï¸ é˜²æ­¢é‡æ”¾æ”»å‡»
- ğŸ”‘ æ”¯æŒå¯†ç åŠ ç›å­˜å‚¨

### 3.2 SCRAMç”¨æˆ·ç®¡ç†


**3.2.1 åˆ›å»ºSCRAMç”¨æˆ·**

```bash
# åˆ›å»ºSCRAM-SHA-256ç”¨æˆ·
kafka-configs.sh --bootstrap-server localhost:9092 \
    --alter --add-config 'SCRAM-SHA-256=[password=alice-password]' \
    --entity-type users --entity-name alice

# åˆ›å»ºSCRAM-SHA-512ç”¨æˆ·ï¼ˆæ›´å®‰å…¨ï¼‰
kafka-configs.sh --bootstrap-server localhost:9092 \
    --alter --add-config 'SCRAM-SHA-512=[password=bob-password]' \
    --entity-type users --entity-name bob

# æŸ¥çœ‹ç”¨æˆ·é…ç½®
kafka-configs.sh --bootstrap-server localhost:9092 \
    --describe --entity-type users --entity-name alice
```

**3.2.2 ç”¨æˆ·å¯†ç ç®¡ç†**

```bash
# ä¿®æ”¹ç”¨æˆ·å¯†ç 
kafka-configs.sh --bootstrap-server localhost:9092 \
    --alter --add-config 'SCRAM-SHA-256=[password=new-password]' \
    --entity-type users --entity-name alice

# åˆ é™¤ç”¨æˆ·
kafka-configs.sh --bootstrap-server localhost:9092 \
    --alter --delete-config 'SCRAM-SHA-256' \
    --entity-type users --entity-name alice

# åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
kafka-configs.sh --bootstrap-server localhost:9092 \
    --describe --entity-type users
```

### 3.3 æœåŠ¡å™¨ç«¯SCRAMé…ç½®


**server.propertiesé…ç½®**ï¼š
```properties
# å¯ç”¨SCRAMè®¤è¯
listeners=SASL_PLAINTEXT://0.0.0.0:9092
security.inter.broker.protocol=SASL_PLAINTEXT
sasl.mechanism.inter.broker.protocol=SCRAM-SHA-256
sasl.enabled.mechanisms=SCRAM-SHA-256,SCRAM-SHA-512

# Brokeré—´é€šä¿¡è®¤è¯
listener.name.sasl_plaintext.scram-sha-256.sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \
    username="admin" \
    password="admin-password";
```

### 3.4 å®¢æˆ·ç«¯SCRAMé…ç½®


**é…ç½®æ–‡ä»¶æ–¹å¼**ï¼š
```properties
security.protocol=SASL_PLAINTEXT
sasl.mechanism=SCRAM-SHA-256
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \
    username="alice" \
    password="alice-password";
```

**Javaå®¢æˆ·ç«¯é…ç½®**ï¼š
```java
props.put("sasl.mechanism", "SCRAM-SHA-256");
props.put("sasl.jaas.config", 
    "org.apache.kafka.common.security.scram.ScramLoginModule required " +
    "username=\"alice\" " +
    "password=\"alice-password\";");
```

---

## 4. ğŸ« Kerberosè®¤è¯é›†æˆ


### 4.1 Kerberosè®¤è¯åŸç†


**Kerberosç®€å•ç†è§£**ï¼šKerberoså°±åƒæ˜¯ä¼ä¸šçš„"é€šè¡Œè¯ç³»ç»Ÿ"ï¼Œä¸€æ¬¡ç™»å½•å¯ä»¥è®¿é—®å¤šä¸ªæœåŠ¡ã€‚

```
Kerberosè®¤è¯æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â‘ è¯·æ±‚ç¥¨æ®    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ KDCæœåŠ¡å™¨    â”‚
â”‚             â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ (è®¤è¯ä¸­å¿ƒ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â‘¡è¿”å›ç¥¨æ®    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                           âˆ§
       â”‚â‘¢ä½¿ç”¨ç¥¨æ®è®¿é—®                 â”‚â‘£éªŒè¯ç¥¨æ®
       âˆ¨                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KafkaæœåŠ¡å™¨  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ KDCæœåŠ¡å™¨    â”‚
â”‚             â”‚                â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Kerberosç¯å¢ƒé…ç½®


**4.2.1 åˆ›å»ºæœåŠ¡ä¸»ä½“**

```bash
# ä¸ºKafkaåˆ›å»ºæœåŠ¡ä¸»ä½“
kadmin.local -q "addprinc -randkey kafka/broker1.example.com@EXAMPLE.COM"
kadmin.local -q "addprinc -randkey kafka/broker2.example.com@EXAMPLE.COM"

# ä¸ºå®¢æˆ·ç«¯åˆ›å»ºç”¨æˆ·ä¸»ä½“
kadmin.local -q "addprinc alice@EXAMPLE.COM"

# å¯¼å‡ºkeytabæ–‡ä»¶
kadmin.local -q "ktadd -k /etc/kafka/kafka.keytab kafka/broker1.example.com@EXAMPLE.COM"
```

**4.2.2 æœåŠ¡å™¨Kerberosé…ç½®**

`server.properties`ï¼š
```properties
listeners=SASL_PLAINTEXT://0.0.0.0:9092
security.inter.broker.protocol=SASL_PLAINTEXT
sasl.mechanism.inter.broker.protocol=GSSAPI
sasl.enabled.mechanisms=GSSAPI
sasl.kerberos.service.name=kafka
```

`kafka_server_jaas.conf`ï¼š
```
KafkaServer {
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    storeKey=true
    keyTab="/etc/kafka/kafka.keytab"
    principal="kafka/broker1.example.com@EXAMPLE.COM";
};
```

### 4.3 å®¢æˆ·ç«¯Kerberosé…ç½®


**é…ç½®æ–‡ä»¶**ï¼š
```properties
security.protocol=SASL_PLAINTEXT
sasl.mechanism=GSSAPI
sasl.kerberos.service.name=kafka
sasl.jaas.config=com.sun.security.auth.module.Krb5LoginModule required \
    useTicketCache=true \
    principal="alice@EXAMPLE.COM";
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# è·å–Kerberosç¥¨æ®
kinit alice@EXAMPLE.COM

# ä½¿ç”¨Kafkaå‘½ä»¤
kafka-console-producer.sh \
    --bootstrap-server broker1.example.com:9092 \
    --topic test-topic \
    --producer.config client.properties
```

---

## 5. ğŸ‘¥ ç”¨æˆ·å‡­æ®ç®¡ç†


### 5.1 ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†


**5.1.1 æ‰¹é‡ç”¨æˆ·åˆ›å»º**

```bash
#!/bin/bash
# æ‰¹é‡åˆ›å»ºç”¨æˆ·è„šæœ¬

users=("alice" "bob" "charlie" "diana")
password_prefix="secure-pwd-"

for user in "${users[@]}"; do
    echo "åˆ›å»ºç”¨æˆ·: $user"
    kafka-configs.sh --bootstrap-server localhost:9092 \
        --alter --add-config "SCRAM-SHA-256=[password=${password_prefix}${user}]" \
        --entity-type users --entity-name $user
    
    if [ $? -eq 0 ]; then
        echo "âœ… ç”¨æˆ· $user åˆ›å»ºæˆåŠŸ"
    else
        echo "âŒ ç”¨æˆ· $user åˆ›å»ºå¤±è´¥"
    fi
done
```

**5.1.2 ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢**

```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
kafka-configs.sh --bootstrap-server localhost:9092 \
    --describe --entity-type users

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·è¯¦æƒ…
kafka-configs.sh --bootstrap-server localhost:9092 \
    --describe --entity-type users --entity-name alice

# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
kafka-configs.sh --bootstrap-server localhost:9092 \
    --describe --entity-type users --entity-name alice 2>/dev/null | grep -q "alice" && echo "ç”¨æˆ·å­˜åœ¨" || echo "ç”¨æˆ·ä¸å­˜åœ¨"
```

### 5.2 å¯†ç å®‰å…¨ç­–ç•¥


**5.2.1 å¯†ç å¤æ‚åº¦è¦æ±‚**

å»ºè®®çš„å¯†ç è§„èŒƒï¼š
- ğŸ”¢ **æœ€å°é•¿åº¦**ï¼šè‡³å°‘12ä½å­—ç¬¦
- ğŸ”¤ **å­—ç¬¦ç»„åˆ**ï¼šå¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šå­—ç¬¦
- ğŸš« **é¿å…å¼±å¯†ç **ï¼šä¸ä½¿ç”¨å¸¸è§å¯†ç æˆ–ä¸ªäººä¿¡æ¯
- ğŸ”„ **å®šæœŸæ›´æ¢**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®90å¤©æ›´æ¢ä¸€æ¬¡

**5.2.2 å¯†ç ç®¡ç†è„šæœ¬**

```bash
#!/bin/bash
# å®‰å…¨å¯†ç ç”Ÿæˆå’Œæ›´æ–°è„šæœ¬

generate_password() {
    # ç”Ÿæˆ16ä½éšæœºå¯†ç 
    openssl rand -base64 16 | tr -d "=+/" | cut -c1-16
}

update_user_password() {
    local username=$1
    local new_password=$(generate_password)
    
    echo "ä¸ºç”¨æˆ· $username æ›´æ–°å¯†ç ..."
    kafka-configs.sh --bootstrap-server localhost:9092 \
        --alter --add-config "SCRAM-SHA-256=[password=$new_password]" \
        --entity-type users --entity-name $username
    
    if [ $? -eq 0 ]; then
        echo "âœ… ç”¨æˆ· $username å¯†ç æ›´æ–°æˆåŠŸ"
        echo "æ–°å¯†ç : $new_password"
        # å¯ä»¥å°†å¯†ç å®‰å…¨å­˜å‚¨åˆ°å¯†é’¥ç®¡ç†ç³»ç»Ÿ
    else
        echo "âŒ ç”¨æˆ· $username å¯†ç æ›´æ–°å¤±è´¥"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
update_user_password "alice"
```

### 5.3 æƒé™æœ€å°åŒ–åŸåˆ™


**ç”¨æˆ·æƒé™åˆ†ç±»**ï¼š
```
ç®¡ç†å‘˜ç”¨æˆ· (admin)ï¼š
â”œâ”€â”€ é›†ç¾¤ç®¡ç†æƒé™
â”œâ”€â”€ Topicåˆ›å»º/åˆ é™¤æƒé™  
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†æƒé™
â””â”€â”€ é…ç½®ä¿®æ”¹æƒé™

åº”ç”¨ç”¨æˆ· (app-user)ï¼š
â”œâ”€â”€ ç‰¹å®šTopicè¯»å†™æƒé™
â”œâ”€â”€ Consumer Groupæƒé™
â””â”€â”€ åŸºç¡€è¿æ¥æƒé™

åªè¯»ç”¨æˆ· (read-only)ï¼š
â”œâ”€â”€ ç‰¹å®šTopicè¯»å–æƒé™
â”œâ”€â”€ MetadataæŸ¥çœ‹æƒé™
â””â”€â”€ åŸºç¡€è¿æ¥æƒé™
```

---

## 6. âœ… è®¤è¯æµ‹è¯•éªŒè¯


### 6.1 è¿æ¥æµ‹è¯•


**6.1.1 åŸºç¡€è¿æ¥æµ‹è¯•**

```bash
# æµ‹è¯•PLAINè®¤è¯è¿æ¥
kafka-broker-api-versions.sh \
    --bootstrap-server localhost:9092 \
    --command-config client-plain.properties

# æµ‹è¯•SCRAMè®¤è¯è¿æ¥
kafka-broker-api-versions.sh \
    --bootstrap-server localhost:9092 \
    --command-config client-scram.properties

# æµ‹è¯•è¿æ¥å¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
kafka-log-dirs.sh \
    --bootstrap-server localhost:9092 \
    --command-config client.properties \
    --describe --json | jq '.'
```

**6.1.2 è®¤è¯å¤±è´¥æµ‹è¯•**

```bash
# æ•…æ„ä½¿ç”¨é”™è¯¯å¯†ç æµ‹è¯•
echo "security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=\"alice\" password=\"wrong-password\";" > wrong-auth.properties

# åº”è¯¥çœ‹åˆ°è®¤è¯å¤±è´¥é”™è¯¯
kafka-topics.sh --bootstrap-server localhost:9092 \
    --command-config wrong-auth.properties \
    --list
```

### 6.2 åŠŸèƒ½éªŒè¯æµ‹è¯•


**6.2.1 å®Œæ•´åŠŸèƒ½æµ‹è¯•è„šæœ¬**

```bash
#!/bin/bash
# Kafka SASLè®¤è¯åŠŸèƒ½æµ‹è¯•è„šæœ¬

CONFIG_FILE="client.properties"
BOOTSTRAP_SERVER="localhost:9092"
TEST_TOPIC="auth-test-topic"

echo "ğŸ” å¼€å§‹Kafka SASLè®¤è¯æµ‹è¯•..."

# 1. æµ‹è¯•è¿æ¥
echo "1ï¸âƒ£ æµ‹è¯•åŸºç¡€è¿æ¥..."
if kafka-broker-api-versions.sh --bootstrap-server $BOOTSTRAP_SERVER --command-config $CONFIG_FILE >/dev/null 2>&1; then
    echo "âœ… è¿æ¥æµ‹è¯•æˆåŠŸ"
else
    echo "âŒ è¿æ¥æµ‹è¯•å¤±è´¥"
    exit 1
fi

# 2. æµ‹è¯•Topicæ“ä½œ
echo "2ï¸âƒ£ æµ‹è¯•Topicæ“ä½œ..."
kafka-topics.sh --bootstrap-server $BOOTSTRAP_SERVER \
    --command-config $CONFIG_FILE \
    --create --topic $TEST_TOPIC --partitions 1 --replication-factor 1 --if-not-exists

# 3. æµ‹è¯•ç”Ÿäº§æ¶ˆæ¯
echo "3ï¸âƒ£ æµ‹è¯•æ¶ˆæ¯ç”Ÿäº§..."
echo "Test message $(date)" | kafka-console-producer.sh \
    --bootstrap-server $BOOTSTRAP_SERVER \
    --topic $TEST_TOPIC \
    --producer.config $CONFIG_FILE

# 4. æµ‹è¯•æ¶ˆè´¹æ¶ˆæ¯
echo "4ï¸âƒ£ æµ‹è¯•æ¶ˆæ¯æ¶ˆè´¹..."
timeout 5s kafka-console-consumer.sh \
    --bootstrap-server $BOOTSTRAP_SERVER \
    --topic $TEST_TOPIC \
    --consumer.config $CONFIG_FILE \
    --from-beginning

# 5. æ¸…ç†æµ‹è¯•æ•°æ®
echo "5ï¸âƒ£ æ¸…ç†æµ‹è¯•æ•°æ®..."
kafka-topics.sh --bootstrap-server $BOOTSTRAP_SERVER \
    --command-config $CONFIG_FILE \
    --delete --topic $TEST_TOPIC

echo "âœ… SASLè®¤è¯æµ‹è¯•å®Œæˆï¼"
```

### 6.3 æ€§èƒ½æµ‹è¯•


**6.3.1 è®¤è¯æ€§èƒ½æµ‹è¯•**

```bash
# æ— è®¤è¯æ€§èƒ½åŸºå‡†
kafka-producer-perf-test.sh \
    --topic perf-test \
    --num-records 100000 \
    --record-size 1024 \
    --throughput 10000 \
    --producer-props bootstrap.servers=localhost:9092

# SASLè®¤è¯æ€§èƒ½æµ‹è¯•
kafka-producer-perf-test.sh \
    --topic perf-test \
    --num-records 100000 \
    --record-size 1024 \
    --throughput 10000 \
    --producer-props bootstrap.servers=localhost:9092 \
    --producer.config client.properties
```

**æ€§èƒ½å½±å“å‚è€ƒ**ï¼š
```
è®¤è¯æ–¹å¼æ€§èƒ½å¯¹æ¯”ï¼ˆç›¸å¯¹æ— è®¤è¯ï¼‰ï¼š
PLAINè®¤è¯: ~2-5% æ€§èƒ½æŸå¤±
SCRAMè®¤è¯: ~5-10% æ€§èƒ½æŸå¤±
Kerberos: ~10-15% æ€§èƒ½æŸå¤±
```

---

## 7. ğŸ—ºï¸ æƒé™æ˜ å°„é…ç½®


### 7.1 æƒé™æ˜ å°„è§„åˆ™


**æƒé™æ˜ å°„çš„ä½œç”¨**ï¼šå°†è®¤è¯ç”¨æˆ·æ˜ å°„åˆ°å…·ä½“çš„æƒé™ï¼Œå†³å®šç”¨æˆ·èƒ½åšä»€ä¹ˆæ“ä½œã€‚

```
æƒé™æ˜ å°„æµç¨‹ï¼š
è®¤è¯ç”¨æˆ· âœ æƒé™æ˜ å°„è§„åˆ™ âœ å®é™…æƒé™ âœ å…è®¸/æ‹’ç»æ“ä½œ

ç¤ºä¾‹ï¼š
ç”¨æˆ· "alice" âœ æ˜ å°„è§„åˆ™ âœ "Topic:logs:Read" âœ å¯ä»¥è¯»å–logs topic
ç”¨æˆ· "admin" âœ æ˜ å°„è§„åˆ™ âœ "Cluster:*:*" âœ å¯ä»¥ç®¡ç†æ•´ä¸ªé›†ç¾¤
```

### 7.2 Super Usersé…ç½®


**Super Usersè¯´æ˜**ï¼šSuper Usersæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œç±»ä¼¼äºç³»ç»Ÿç®¡ç†å‘˜ã€‚

```properties
# server.propertiesä¸­é…ç½®Super Users
super.users=User:admin;User:kafka;User:root

# å¤šç”¨æˆ·é…ç½®
super.users=User:admin;User:alice;User:system-user
```

**éªŒè¯Super Usersæƒé™**ï¼š
```bash
# Super Userå¯ä»¥æ‰§è¡Œæ‰€æœ‰æ“ä½œ
kafka-topics.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --create --topic any-topic --partitions 3 --replication-factor 1

# æ™®é€šç”¨æˆ·å¯èƒ½è¢«æ‹’ç»
kafka-topics.sh --bootstrap-server localhost:9092 \
    --command-config user.properties \
    --create --topic restricted-topic --partitions 1 --replication-factor 1
```

### 7.3 ACLæƒé™æ§åˆ¶


**7.3.1 å¯ç”¨ACL**

```properties
# server.properties
authorizer.class.name=kafka.security.authorizer.AclAuthorizer
allow.everyone.if.no.acl.found=false  # é»˜è®¤æ‹’ç»æ‰€æœ‰è®¿é—®
```

**7.3.2 ACLæƒé™ç®¡ç†**

```bash
# ä¸ºç”¨æˆ·aliceæˆäºˆtopicè¯»å–æƒé™
kafka-acls.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --add --allow-principal User:alice \
    --operation Read --topic logs

# ä¸ºç”¨æˆ·bobæˆäºˆç”Ÿäº§è€…æƒé™
kafka-acls.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --add --allow-principal User:bob \
    --operation Write --topic events \
    --producer

# æŸ¥çœ‹ç”¨æˆ·æƒé™
kafka-acls.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --list --principal User:alice

# åˆ é™¤æƒé™
kafka-acls.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --remove --allow-principal User:alice \
    --operation Read --topic logs
```

**7.3.3 æƒé™ç»„åˆç¤ºä¾‹**

```bash
# å®Œæ•´çš„åº”ç”¨ç”¨æˆ·æƒé™é…ç½®
APP_USER="app-service"
TOPIC_PREFIX="app-"
CONSUMER_GROUP="app-consumers"

# æˆäºˆè¯»å†™æŒ‡å®štopicçš„æƒé™
kafka-acls.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --add --allow-principal User:$APP_USER \
    --operation Read --operation Write \
    --topic $TOPIC_PREFIX --resource-pattern-type prefixed

# æˆäºˆconsumer groupæƒé™
kafka-acls.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --add --allow-principal User:$APP_USER \
    --operation Read --group $CONSUMER_GROUP

# æˆäºˆåŸºç¡€é›†ç¾¤æƒé™ï¼ˆæŸ¥çœ‹metadataç­‰ï¼‰
kafka-acls.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --add --allow-principal User:$APP_USER \
    --operation Describe --cluster
```

---

## 8. ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥


### 8.1 è®¤è¯å¤±è´¥æ’æŸ¥


**8.1.1 å¸¸è§é”™è¯¯ç±»å‹**

```bash
# é”™è¯¯1: è®¤è¯æœºåˆ¶ä¸åŒ¹é…
é”™è¯¯ä¿¡æ¯: "Unsupported SASL mechanism: PLAIN"
è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯ç”¨äº†å¯¹åº”çš„SASLæœºåˆ¶

# é”™è¯¯2: ç”¨æˆ·åå¯†ç é”™è¯¯
é”™è¯¯ä¿¡æ¯: "Authentication failed: Invalid username or password"
è§£å†³æ–¹æ¡ˆ: éªŒè¯ç”¨æˆ·å‡­æ®ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨

# é”™è¯¯3: æƒé™ä¸è¶³
é”™è¯¯ä¿¡æ¯: "Not authorized to access topics"
è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥ACLæƒé™é…ç½®ï¼Œç¡®ä¿ç”¨æˆ·æœ‰ç›¸åº”æƒé™
```

**8.1.2 è¯Šæ–­å‘½ä»¤**

```bash
# æ£€æŸ¥æœåŠ¡å™¨é…ç½®
kafka-configs.sh --bootstrap-server localhost:9092 \
    --describe --entity-type brokers --entity-name 0

# éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
kafka-configs.sh --bootstrap-server localhost:9092 \
    --describe --entity-type users --entity-name alice

# æ£€æŸ¥ACLæƒé™
kafka-acls.sh --bootstrap-server localhost:9092 \
    --command-config admin.properties \
    --list --principal User:alice

# æµ‹è¯•ç½‘ç»œè¿æ¥
telnet localhost 9092
```

### 8.2 æ€§èƒ½é—®é¢˜æ’æŸ¥


**8.2.1 è®¤è¯æ€§èƒ½ç›‘æ§**

```bash
# ç›‘æ§è®¤è¯ç›¸å…³JMXæŒ‡æ ‡
jconsole localhost:9999  # è¿æ¥åˆ°Kafka JMXç«¯å£

# å…³é”®æŒ‡æ ‡ï¼š
# - kafka.server:type=SaslServerCallbackHandler,name=AuthenticationFailureRate
# - kafka.server:type=SaslServerCallbackHandler,name=AuthenticationSuccessRate
# - kafka.network:type=SocketServer,name=NetworkProcessorAvgIdlePercent
```

**8.2.2 ä¼˜åŒ–å»ºè®®**

```properties
# ä¼˜åŒ–SASLæ€§èƒ½çš„é…ç½®
sasl.login.refresh.buffer.seconds=300
sasl.login.refresh.min.period.seconds=60
sasl.login.refresh.window.factor=0.8
sasl.login.refresh.window.jitter=0.05

# è¿æ¥æ± ä¼˜åŒ–
connections.max.idle.ms=600000
reconnect.backoff.ms=50
reconnect.backoff.max.ms=1000
```

### 8.3 æ—¥å¿—åˆ†æ


**8.3.1 å¯ç”¨è®¤è¯è°ƒè¯•æ—¥å¿—**

```properties
# log4j.properties
log4j.logger.kafka.security=DEBUG
log4j.logger.org.apache.kafka.common.security=DEBUG
log4j.logger.kafka.authorizer.logger=INFO
```

**8.3.2 å…³é”®æ—¥å¿—è§£è¯»**

```bash
# æˆåŠŸè®¤è¯æ—¥å¿—
grep "Successfully authenticated" server.log

# è®¤è¯å¤±è´¥æ—¥å¿—
grep "Authentication failed" server.log

# æƒé™æ£€æŸ¥æ—¥å¿—
grep "Principal = User:" server.log

# åˆ†æè®¤è¯ç»Ÿè®¡
grep "SASL authentication" server.log | awk '{print $3}' | sort | uniq -c
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SASLè®¤è¯ï¼šKafkaçš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è®¿é—®
ğŸ”¸ è®¤è¯æ–¹å¼ï¼šPLAIN(ç®€å•)ã€SCRAM(å®‰å…¨)ã€Kerberos(ä¼ä¸šçº§)
ğŸ”¸ ç”¨æˆ·ç®¡ç†ï¼šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ç”¨æˆ·å‡­æ®çš„å‘½ä»¤æ“ä½œ
ğŸ”¸ æƒé™æ§åˆ¶ï¼šé€šè¿‡ACLæ§åˆ¶ç”¨æˆ·å¯ä»¥è®¿é—®çš„èµ„æºå’Œæ“ä½œ
ğŸ”¸ å®‰å…¨åè®®ï¼šSASL_PLAINTEXT vs SASL_SSLçš„é€‰æ‹©
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è®¤è¯vsæˆæƒçš„åŒºåˆ«**
```
è®¤è¯(Authentication)ï¼š
éªŒè¯"ä½ æ˜¯è°" â†’ ç”¨æˆ·åå¯†ç éªŒè¯ â†’ ç¡®è®¤èº«ä»½

æˆæƒ(Authorization)ï¼š
éªŒè¯"ä½ èƒ½åšä»€ä¹ˆ" â†’ ACLæƒé™æ£€æŸ¥ â†’ æ§åˆ¶æ“ä½œ
```

**ğŸ”¹ å®‰å…¨çº§åˆ«çš„æƒè¡¡**
```
å¼€å‘ç¯å¢ƒï¼šPLAIN + SASL_PLAINTEXT
- é…ç½®ç®€å•ï¼Œæ€§èƒ½æœ€å¥½
- å®‰å…¨æ€§è¾ƒä½ï¼Œé€‚åˆå†…ç½‘æµ‹è¯•

ç”Ÿäº§ç¯å¢ƒï¼šSCRAM + SASL_SSL  
- å®‰å…¨æ€§é«˜ï¼Œå¯†ç ä¸æ˜æ–‡ä¼ è¾“
- é…ç½®é€‚ä¸­ï¼Œæ€§èƒ½å½±å“å¯æ¥å—

ä¼ä¸šç¯å¢ƒï¼šKerberos + SASL_SSL
- å®‰å…¨æ€§æœ€é«˜ï¼Œç»Ÿä¸€èº«ä»½ç®¡ç†
- é…ç½®å¤æ‚ï¼Œéœ€è¦é¢å¤–åŸºç¡€è®¾æ–½
```

**ğŸ”¹ ç”¨æˆ·æƒé™è®¾è®¡åŸåˆ™**
```
æœ€å°æƒé™åŸåˆ™ï¼š
- ç”¨æˆ·åªè·å¾—å®Œæˆå·¥ä½œæ‰€éœ€çš„æœ€å°æƒé™
- å®šæœŸå®¡æŸ¥å’Œæ¸…ç†ä¸å¿…è¦çš„æƒé™
- ä½¿ç”¨ä¸“ç”¨è´¦å·è€Œä¸æ˜¯å…±äº«è´¦å·

æƒé™åˆ†å±‚ç®¡ç†ï¼š
- ç®¡ç†å‘˜ï¼šé›†ç¾¤ç®¡ç†æƒé™
- åº”ç”¨ç”¨æˆ·ï¼šç‰¹å®štopicè¯»å†™æƒé™  
- ç›‘æ§ç”¨æˆ·ï¼šåªè¯»æƒé™
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é…ç½®é€‰æ‹©å»ºè®®**ï¼š
- ğŸ”° **æ–°æ‰‹å­¦ä¹ **ï¼šä»PLAINè®¤è¯å¼€å§‹ï¼Œç†è§£åŸºæœ¬æ¦‚å¿µ
- ğŸ¢ **ä¼ä¸šç¯å¢ƒ**ï¼šä¼˜å…ˆé€‰æ‹©SCRAMæˆ–Kerberos
- ğŸš€ **æ€§èƒ½æ•æ„Ÿ**ï¼šåœ¨å®‰å…¨å’Œæ€§èƒ½é—´æ‰¾åˆ°å¹³è¡¡ç‚¹
- ğŸ”’ **é«˜å®‰å…¨è¦æ±‚**ï¼šä½¿ç”¨SASL_SSL + Kerberosç»„åˆ

**è¿ç»´æœ€ä½³å®è·µ**ï¼š
- ğŸ“ **æ–‡æ¡£åŒ–**ï¼šè®°å½•æ‰€æœ‰ç”¨æˆ·å’Œæƒé™é…ç½®
- ğŸ”„ **å®šæœŸè½®æ¢**ï¼šå®šæœŸæ›´æ¢å¯†ç å’Œè¯ä¹¦
- ğŸ“Š **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§è®¤è¯å¤±è´¥ç‡å’Œå¼‚å¸¸è®¿é—®
- ğŸ§ª **æµ‹è¯•éªŒè¯**ï¼šå®šæœŸæµ‹è¯•è®¤è¯å’Œæƒé™é…ç½®

### 9.4 æ•…éšœæ’æŸ¥è¦ç‚¹


**å¸¸è§é—®é¢˜åŠè§£å†³æ€è·¯**ï¼š
```
é—®é¢˜ç±»å‹          æ’æŸ¥æ­¥éª¤                     è§£å†³æ–¹å‘
è®¤è¯å¤±è´¥     â†’    æ£€æŸ¥ç”¨æˆ·å‡­æ®å’Œé…ç½®æ–‡ä»¶      â†’    ä¿®å¤é…ç½®æˆ–é‡ç½®å¯†ç 
è¿æ¥è¢«æ‹’ç»   â†’    æ£€æŸ¥ç½‘ç»œå’Œç«¯å£é…ç½®          â†’    ä¿®å¤ç½‘ç»œæˆ–é˜²ç«å¢™
æƒé™ä¸è¶³     â†’    æ£€æŸ¥ACLæƒé™è®¾ç½®            â†’    æ·»åŠ å¿…è¦æƒé™  
æ€§èƒ½é—®é¢˜     â†’    æ£€æŸ¥è®¤è¯æ–¹å¼å’ŒJVMé…ç½®      â†’    ä¼˜åŒ–é…ç½®å‚æ•°
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- SASLæ˜¯Kafkaçš„å®‰å…¨é—¨å«ï¼Œæ§åˆ¶è°èƒ½è¿›å…¥
- PLAINç®€å•ä½†ä¸å®‰å…¨ï¼ŒSCRAMå®‰å…¨ä¸”å®ç”¨ï¼ŒKerberosä¼ä¸šçº§
- è®¤è¯è§£å†³"ä½ æ˜¯è°"ï¼Œæˆæƒè§£å†³"ä½ èƒ½åšä»€ä¹ˆ"
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨SSLåŠ å¯†ä¼ è¾“æ•æ„Ÿè®¤è¯ä¿¡æ¯
- æƒé™è®¾è®¡éµå¾ªæœ€å°åŒ–åŸåˆ™ï¼Œå®šæœŸå®¡æŸ¥å’Œç»´æŠ¤