---
title: 7ã€Avroç”Ÿäº§è€…
---
## ðŸ“š ç›®å½•

1. [Avroç”Ÿäº§è€…åŸºç¡€æ¦‚å¿µ](#1-avroç”Ÿäº§è€…åŸºç¡€æ¦‚å¿µ)
2. [Schema Registryæ ¸å¿ƒç†è§£](#2-schema-registryæ ¸å¿ƒç†è§£)
3. [Avroç”Ÿäº§è€…å‘½ä»¤è¯¦è§£](#3-avroç”Ÿäº§è€…å‘½ä»¤è¯¦è§£)
4. [Schemaå®šä¹‰ä¸Žç®¡ç†](#4-schemaå®šä¹‰ä¸Žç®¡ç†)
5. [å®žæˆ˜æ“ä½œæ¼”ç»ƒ](#5-å®žæˆ˜æ“ä½œæ¼”ç»ƒ)
6. [é”™è¯¯å¤„ç†ä¸Žæ•…éšœæŽ’æŸ¥](#6-é”™è¯¯å¤„ç†ä¸Žæ•…éšœæŽ’æŸ¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ” Avroç”Ÿäº§è€…åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Avroç”Ÿäº§è€…


**ðŸ”¸ æ ¸å¿ƒæ¦‚å¿µç†è§£**
```
Avroç”Ÿäº§è€…ï¼šä¸“é—¨å‘é€Avroæ ¼å¼æ•°æ®çš„Kafkaç”Ÿäº§è€…å·¥å…·
Avroæ ¼å¼ï¼šApacheå¼€å‘çš„æ•°æ®åºåˆ—åŒ–ç³»ç»Ÿ
ä½œç”¨ï¼šç»“æž„åŒ–æ•°æ®ä¼ è¾“ï¼Œæ”¯æŒæ•°æ®æ¼”è¿›å’Œç‰ˆæœ¬å…¼å®¹
```

**ðŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦Avroï¼Ÿ**

ä¼ ç»Ÿæ–‡æœ¬æ•°æ®çš„é—®é¢˜ï¼š
```
æ™®é€šJSONæ•°æ®ï¼š
{"name": "å¼ ä¸‰", "age": 25, "city": "åŒ—äº¬"}

é—®é¢˜ï¼š
âœ— æ•°æ®é‡å¤§ï¼šé‡å¤çš„å­—æ®µåå ç”¨ç©ºé—´
âœ— æ— çº¦æŸï¼šå¯ä»¥éšæ„å†™å…¥ä»»ä½•æ ¼å¼
âœ— ç‰ˆæœ¬æ··ä¹±ï¼šæ•°æ®æ ¼å¼å˜åŒ–éš¾ä»¥ç®¡ç†
```

Avroæ ¼å¼çš„ä¼˜åŠ¿ï¼š
```
Avroæ•°æ®ç‰¹ç‚¹ï¼š
âœ“ ä½“ç§¯å°ï¼šäºŒè¿›åˆ¶æ ¼å¼ï¼ŒåŽ‹ç¼©æ•ˆçŽ‡é«˜
âœ“ æœ‰çº¦æŸï¼šå¿…é¡»æŒ‰Schemaå®šä¹‰çš„ç»“æž„
âœ“ ç‰ˆæœ¬ç®¡ç†ï¼šæ”¯æŒæ•°æ®æ ¼å¼æ¼”è¿›
âœ“ å…¼å®¹æ€§ï¼šæ–°æ—§ç‰ˆæœ¬å¯ä»¥äº’ç›¸è¯»å–
```

### 1.2 Avroåœ¨Kafkaä¸­çš„åº”ç”¨åœºæ™¯


**ðŸŽ¯ å…¸åž‹ä½¿ç”¨åœºæ™¯**
```
å¾®æœåŠ¡æ•°æ®äº¤æ¢ï¼š
æœåŠ¡A ---[ç”¨æˆ·ä¿¡æ¯Avro]---> Kafka ---[ç”¨æˆ·ä¿¡æ¯Avro]---> æœåŠ¡B
ç¡®ä¿æ•°æ®æ ¼å¼ä¸€è‡´ï¼Œé¿å…è§£æžé”™è¯¯

æ•°æ®ç®¡é“ï¼š
æ•°æ®åº“ ---[è¡¨ç»“æž„Avro]---> Kafka ---[ETLå¤„ç†]---> æ•°æ®ä»“åº“
ä¿è¯æ•°æ®ç»“æž„çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§

å®žæ—¶åˆ†æžï¼š
APP ---[äº‹ä»¶Avro]---> Kafka ---[å®žæ—¶è®¡ç®—]---> ç›‘æŽ§å¤§å±
æ ‡å‡†åŒ–äº‹ä»¶æ ¼å¼ï¼Œä¾¿äºŽåˆ†æžå¤„ç†
```

### 1.3 Avro vs æ™®é€šæ•°æ®å¯¹æ¯”


| å¯¹æ¯”ç»´åº¦ | **æ™®é€šæ–‡æœ¬æ•°æ®** | **Avroæ•°æ®** |
|---------|----------------|-------------|
| ðŸ”¸ **æ•°æ®å¤§å°** | `è¾ƒå¤§ï¼ˆJSONé‡å¤å­—æ®µåï¼‰` | `è¾ƒå°ï¼ˆäºŒè¿›åˆ¶åŽ‹ç¼©ï¼‰` |
| ðŸ”¸ **æ ¼å¼çº¦æŸ** | `æ— çº¦æŸï¼Œæ˜“å‡ºé”™` | `å¼ºçº¦æŸï¼Œæ•°æ®è§„èŒƒ` |
| ðŸ”¸ **ç‰ˆæœ¬ç®¡ç†** | `æ‰‹åŠ¨ç®¡ç†ï¼Œæ˜“å†²çª` | `è‡ªåŠ¨ç‰ˆæœ¬æŽ§åˆ¶` |
| ðŸ”¸ **å…¼å®¹æ€§** | `æ–°æ—§æ ¼å¼äº’ä¸å…¼å®¹` | `å‘å‰å‘åŽå…¼å®¹` |
| ðŸ”¸ **å¤„ç†é€Ÿåº¦** | `è§£æžè¾ƒæ…¢` | `åºåˆ—åŒ–ååºåˆ—åŒ–å¿«` |

---

## 2. ðŸ—ï¸ Schema Registryæ ¸å¿ƒç†è§£


### 2.1 Schema Registryæ˜¯ä»€ä¹ˆ


**ðŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
Schema Registryï¼šAvroæ•°æ®æ ¼å¼çš„"ç®¡ç†ä¸­å¿ƒ"
ä½œç”¨ï¼šå­˜å‚¨ã€ç®¡ç†ã€éªŒè¯æ‰€æœ‰Avro Schemaå®šä¹‰
ä½ç½®ï¼šç‹¬ç«‹æœåŠ¡ï¼Œé€šå¸¸ä¸ŽKafkaé›†ç¾¤é…å¥—éƒ¨ç½²
```

**ðŸ¢ Schema Registryæž¶æž„å›¾**
```
         åº”ç”¨ç¨‹åº                    Schema Registry
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ç”Ÿäº§è€…åº”ç”¨     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Schemaå­˜å‚¨ç®¡ç†  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                 â”‚
            â–¼                                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚   Kafka Broker  â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
            â”‚                                 â”‚
            â–¼                                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   æ¶ˆè´¹è€…åº”ç”¨     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Schemaç‰ˆæœ¬æŽ§åˆ¶  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å·¥ä½œæµç¨‹ï¼š
1. ç”Ÿäº§è€…å‘Schema Registryæ³¨å†Œæ•°æ®Schema
2. Schema Registryåˆ†é…ç‰ˆæœ¬å·å¹¶å­˜å‚¨
3. ç”Ÿäº§è€…ä½¿ç”¨Schemaåºåˆ—åŒ–æ•°æ®å‘é€åˆ°Kafka
4. æ¶ˆè´¹è€…ä»ŽSchema RegistryèŽ·å–Schemaååºåˆ—åŒ–æ•°æ®
```

### 2.2 Schema Registryçš„æ ¸å¿ƒåŠŸèƒ½


**ðŸ“‹ ä¸»è¦åŠŸèƒ½åˆ—è¡¨**
```
ðŸ”¸ Schemaå­˜å‚¨ç®¡ç†
â€¢ é›†ä¸­å­˜å‚¨æ‰€æœ‰Avro Schemaå®šä¹‰
â€¢ ä¸ºæ¯ä¸ªSchemaåˆ†é…å”¯ä¸€ID
â€¢ æ”¯æŒä¸»é¢˜çº§åˆ«çš„Schemaç®¡ç†

ðŸ”¸ ç‰ˆæœ¬æŽ§åˆ¶
â€¢ è‡ªåŠ¨ç®¡ç†Schemaç‰ˆæœ¬æ¼”è¿›
â€¢ æ”¯æŒå‘å‰å…¼å®¹ã€å‘åŽå…¼å®¹
â€¢ ç‰ˆæœ¬å›žæ»šå’ŒåŽ†å²æŸ¥è¯¢

ðŸ”¸ å…¼å®¹æ€§æ£€æŸ¥
â€¢ æ–°Schemaæ³¨å†Œå‰è‡ªåŠ¨å…¼å®¹æ€§éªŒè¯
â€¢ é˜²æ­¢ç ´åæ€§å˜æ›´
â€¢ æ”¯æŒä¸åŒå…¼å®¹æ€§ç­–ç•¥

ðŸ”¸ RESTful API
â€¢ æä¾›HTTPæŽ¥å£ç®¡ç†Schema
â€¢ æ”¯æŒç¨‹åºåŒ–æ“ä½œ
â€¢ é›†æˆå¼€å‘å·¥å…·å‹å¥½
```

### 2.3 Schemaå…¼å®¹æ€§ç­–ç•¥


**âš–ï¸ å…¼å®¹æ€§ç±»åž‹è¯¦è§£**
```
å‘åŽå…¼å®¹ï¼ˆBACKWARDï¼‰ï¼š
æ–°Schemaå¯ä»¥è¯»å–æ—§æ•°æ®
ç¤ºä¾‹ï¼šç»™ç”¨æˆ·è¡¨æ–°å¢žå¯é€‰å­—æ®µ"email"
æ—§æ•°æ®: {"name": "å¼ ä¸‰", "age": 25}
æ–°Schema: å¯ä»¥æ­£å¸¸è¯»å–ï¼Œemailå­—æ®µä¸ºé»˜è®¤å€¼

å‘å‰å…¼å®¹ï¼ˆFORWARDï¼‰ï¼š
æ—§Schemaå¯ä»¥è¯»å–æ–°æ•°æ®
ç¤ºä¾‹ï¼šåˆ é™¤ç”¨æˆ·è¡¨çš„å¯é€‰å­—æ®µ"city"
æ–°æ•°æ®: {"name": "æŽå››", "age": 30}
æ—§Schema: å¯ä»¥æ­£å¸¸è¯»å–ï¼Œå¿½ç•¥ç¼ºå¤±çš„cityå­—æ®µ

å®Œå…¨å…¼å®¹ï¼ˆFULLï¼‰ï¼š
æ—¢å‘å‰åˆå‘åŽå…¼å®¹
ç¤ºä¾‹ï¼šåªå…è®¸æ·»åŠ å¸¦é»˜è®¤å€¼çš„å­—æ®µ

æ— å…¼å®¹æ€§ï¼ˆNONEï¼‰ï¼š
ä¸è¿›è¡Œå…¼å®¹æ€§æ£€æŸ¥ï¼Œä»»ä½•å˜æ›´éƒ½å…è®¸
é£Žé™©ï¼šå¯èƒ½å¯¼è‡´æ•°æ®è§£æžå¤±è´¥
```

---

## 3. ðŸ› ï¸ Avroç”Ÿäº§è€…å‘½ä»¤è¯¦è§£


### 3.1 æ ¸å¿ƒå‘½ä»¤å·¥å…·


**ðŸ”§ ä¸»è¦å‘½ä»¤å·¥å…·**
```bash
# AvroæŽ§åˆ¶å°ç”Ÿäº§è€…ï¼ˆä¸»è¦å·¥å…·ï¼‰
kafka-avro-console-producer

# ç›¸å…³è¾…åŠ©å·¥å…·
kafka-console-producer         # æ™®é€šæ–‡æœ¬ç”Ÿäº§è€…
kafka-avro-console-consumer    # AvroæŽ§åˆ¶å°æ¶ˆè´¹è€…
kafka-topics                   # ä¸»é¢˜ç®¡ç†å·¥å…·
```

### 3.2 åŸºç¡€å‘½ä»¤ç»“æž„


**ðŸ“ å‘½ä»¤åŸºæœ¬è¯­æ³•**
```bash
kafka-avro-console-producer \
  --bootstrap-server localhost:9092 \
  --topic ä¸»é¢˜åç§° \
  --schema-registry-url http://localhost:8081 \
  --value-schema '{"type":"record",...}' \
  [å…¶ä»–å¯é€‰å‚æ•°]
```

**ðŸ”¸ å¿…éœ€å‚æ•°è¯¦è§£**

| å‚æ•°åç§° | **ä½œç”¨è¯´æ˜Ž** | **ç¤ºä¾‹å€¼** |
|---------|-------------|-----------|
| `--bootstrap-server` | `æŒ‡å®šKafkaé›†ç¾¤åœ°å€` | `localhost:9092` |
| `--topic` | `æŒ‡å®šç›®æ ‡ä¸»é¢˜åç§°` | `user-events` |
| `--schema-registry-url` | `æŒ‡å®šSchema Registryåœ°å€` | `http://localhost:8081` |
| `--value-schema` | `æŒ‡å®šæ¶ˆæ¯å€¼çš„Schemaå®šä¹‰` | `è§ä¸‹æ–¹ç¤ºä¾‹` |

### 3.3 Schemaå®šä¹‰å‚æ•°


**ðŸ”‘ é”®å€¼Schemaå‚æ•°**
```bash
# ä»…å®šä¹‰å€¼çš„Schemaï¼ˆæœ€å¸¸ç”¨ï¼‰
--value-schema '{"type":"record","name":"User","fields":[...]}'

# åŒæ—¶å®šä¹‰é”®å’Œå€¼çš„Schema
--key-schema '{"type":"string"}'
--value-schema '{"type":"record","name":"User","fields":[...]}'

# ä½¿ç”¨Schemaæ–‡ä»¶ï¼ˆæŽ¨èç”Ÿäº§çŽ¯å¢ƒï¼‰
--value-schema-file /path/to/user-schema.avsc
--key-schema-file /path/to/key-schema.avsc
```

**âš ï¸ Schemaå‚æ•°ä½¿ç”¨å»ºè®®**
```
å¼€å‘æµ‹è¯•çŽ¯å¢ƒï¼š
âœ“ ä½¿ç”¨ --value-schema ç›´æŽ¥æŒ‡å®š
âœ“ å¿«é€ŸéªŒè¯å’Œè°ƒè¯•

ç”Ÿäº§çŽ¯å¢ƒï¼š
âœ“ ä½¿ç”¨ --value-schema-file æ–‡ä»¶æ–¹å¼
âœ“ ä¾¿äºŽç‰ˆæœ¬ç®¡ç†å’Œå›¢é˜Ÿåä½œ
âœ“ é¿å…å‘½ä»¤è¡Œè¿‡é•¿å’Œè½¬ä¹‰é—®é¢˜
```

### 3.4 é«˜çº§é…ç½®å‚æ•°


**ðŸ”§ åºåˆ—åŒ–é…ç½®**
```bash
# æŒ‡å®šåºåˆ—åŒ–å™¨ç±»åž‹
--property value.serializer=io.confluent.kafka.serializers.KafkaAvroSerializer
--property key.serializer=io.confluent.kafka.serializers.KafkaAvroSerializer

# Schema Registryè®¤è¯é…ç½®
--property schema.registry.basic.auth.credentials.source=USER_INFO
--property schema.registry.basic.auth.user.info=ç”¨æˆ·å:å¯†ç 

# SSLé…ç½®ï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰
--property schema.registry.url=https://localhost:8081
--property schema.registry.ssl.truststore.location=/path/to/truststore
--property schema.registry.ssl.truststore.password=å¯†ç 
```

---

## 4. ðŸ“‹ Schemaå®šä¹‰ä¸Žç®¡ç†


### 4.1 Avro SchemaåŸºç¡€è¯­æ³•


**ðŸ”¸ åŸºæœ¬æ•°æ®ç±»åž‹**
```json
{
  "type": "record",
  "name": "BasicTypes",
  "fields": [
    {"name": "text_field", "type": "string"},
    {"name": "number_field", "type": "int"},
    {"name": "decimal_field", "type": "long"},
    {"name": "flag_field", "type": "boolean"},
    {"name": "price_field", "type": "float"},
    {"name": "timestamp_field", "type": "double"}
  ]
}
```

**ðŸ”¸ å¤æ‚æ•°æ®ç±»åž‹**
```json
{
  "type": "record",
  "name": "ComplexTypes",
  "fields": [
    {
      "name": "optional_field",
      "type": ["null", "string"],
      "default": null
    },
    {
      "name": "array_field",
      "type": {"type": "array", "items": "string"}
    },
    {
      "name": "map_field",
      "type": {"type": "map", "values": "int"}
    },
    {
      "name": "enum_field",
      "type": {
        "type": "enum",
        "name": "Status",
        "symbols": ["ACTIVE", "INACTIVE", "PENDING"]
      }
    }
  ]
}
```

### 4.2 å®žç”¨Schemaç¤ºä¾‹


**ðŸ‘¤ ç”¨æˆ·ä¿¡æ¯Schema**
```json
{
  "type": "record",
  "name": "User",
  "namespace": "com.company.user",
  "fields": [
    {"name": "id", "type": "string"},
    {"name": "name", "type": "string"},
    {"name": "email", "type": ["null", "string"], "default": null},
    {"name": "age", "type": "int"},
    {"name": "created_at", "type": "long"},
    {"name": "status", "type": {
      "type": "enum",
      "name": "UserStatus",
      "symbols": ["ACTIVE", "INACTIVE", "SUSPENDED"]
    }}
  ]
}
```

**ðŸ“Š äº‹ä»¶æ—¥å¿—Schema**
```json
{
  "type": "record",
  "name": "EventLog",
  "namespace": "com.company.events",
  "fields": [
    {"name": "event_id", "type": "string"},
    {"name": "user_id", "type": "string"},
    {"name": "event_type", "type": "string"},
    {"name": "timestamp", "type": "long"},
    {"name": "properties", "type": {"type": "map", "values": "string"}},
    {"name": "session_id", "type": ["null", "string"], "default": null}
  ]
}
```

### 4.3 Schemaç‰ˆæœ¬æ¼”è¿›ç¤ºä¾‹


**ðŸ“ˆ Schemaæ¼”è¿›è¿‡ç¨‹**
```
ç‰ˆæœ¬1 - åˆå§‹Schemaï¼š
{
  "type": "record", "name": "Product",
  "fields": [
    {"name": "id", "type": "string"},
    {"name": "name", "type": "string"},
    {"name": "price", "type": "double"}
  ]
}

ç‰ˆæœ¬2 - æ·»åŠ å¯é€‰å­—æ®µï¼ˆå‘åŽå…¼å®¹ï¼‰ï¼š
{
  "type": "record", "name": "Product",
  "fields": [
    {"name": "id", "type": "string"},
    {"name": "name", "type": "string"},
    {"name": "price", "type": "double"},
    {"name": "category", "type": ["null", "string"], "default": null}
  ]
}

ç‰ˆæœ¬3 - ä¿®æ”¹å­—æ®µç±»åž‹ï¼ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰ï¼š
{
  "type": "record", "name": "Product",
  "fields": [
    {"name": "id", "type": "string"},
    {"name": "name", "type": "string"},
    {"name": "price", "type": "string"},  // doubleæ”¹ä¸ºstring
    {"name": "category", "type": ["null", "string"], "default": null}
  ]
}
æ³¨æ„ï¼šç±»åž‹å˜æ›´é€šå¸¸éœ€è¦æ•°æ®è¿ç§»ç­–ç•¥
```

---

## 5. ðŸš€ å®žæˆ˜æ“ä½œæ¼”ç»ƒ


### 5.1 çŽ¯å¢ƒå‡†å¤‡


**ðŸ”§ å¯åŠ¨å¿…è¦æœåŠ¡**
```bash
# 1. å¯åŠ¨Zookeeper
bin/zookeeper-server-start.sh config/zookeeper.properties

# 2. å¯åŠ¨Kafka Broker
bin/kafka-server-start.sh config/server.properties

# 3. å¯åŠ¨Schema Registry
bin/schema-registry-start config/schema-registry.properties
```

**âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥**
```bash
# æ£€æŸ¥Schema Registryæ˜¯å¦æ­£å¸¸
curl http://localhost:8081/subjects

# æ£€æŸ¥Kafkaé›†ç¾¤
bin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092
```

### 5.2 åˆ›å»ºä¸»é¢˜å’ŒSchema


**ðŸ“ åˆ›å»ºAvroä¸»é¢˜**
```bash
# åˆ›å»ºä¸“ç”¨ä¸»é¢˜
bin/kafka-topics.sh --create \
  --bootstrap-server localhost:9092 \
  --topic user-avro-topic \
  --partitions 3 \
  --replication-factor 1
```

**ðŸ“‹ å‡†å¤‡Schemaæ–‡ä»¶**
```bash
# åˆ›å»ºSchemaæ–‡ä»¶
cat > user-schema.avsc << 'EOF'
{
  "type": "record",
  "name": "User",
  "namespace": "com.example",
  "fields": [
    {"name": "id", "type": "string"},
    {"name": "name", "type": "string"},
    {"name": "email", "type": ["null", "string"], "default": null},
    {"name": "age", "type": "int"}
  ]
}
EOF
```

### 5.3 åŸºç¡€ç”Ÿäº§è€…æ“ä½œ


**ðŸ”¸ ä½¿ç”¨å†…è”Schema**
```bash
bin/kafka-avro-console-producer \
  --bootstrap-server localhost:9092 \
  --topic user-avro-topic \
  --schema-registry-url http://localhost:8081 \
  --value-schema '{
    "type": "record",
    "name": "User",
    "fields": [
      {"name": "id", "type": "string"},
      {"name": "name", "type": "string"},
      {"name": "age", "type": "int"}
    ]
  }'
```

**ðŸ”¸ ä½¿ç”¨Schemaæ–‡ä»¶ï¼ˆæŽ¨èï¼‰**
```bash
bin/kafka-avro-console-producer \
  --bootstrap-server localhost:9092 \
  --topic user-avro-topic \
  --schema-registry-url http://localhost:8081 \
  --value-schema-file user-schema.avsc
```

### 5.4 å‘é€æµ‹è¯•æ•°æ®


**ðŸ“¤ è¾“å…¥æ•°æ®ç¤ºä¾‹**
```json
{"id": "001", "name": "å¼ ä¸‰", "email": "zhangsan@example.com", "age": 25}
{"id": "002", "name": "æŽå››", "email": null, "age": 30}
{"id": "003", "name": "çŽ‹äº”", "age": 28}
```

**âš ï¸ æ•°æ®æ ¼å¼æ³¨æ„äº‹é¡¹**
```
æ­£ç¡®æ ¼å¼ï¼š
âœ“ å¿…é¡»ç¬¦åˆJSONæ ¼å¼
âœ“ å­—æ®µåå¿…é¡»ä¸ŽSchemaå®šä¹‰ä¸€è‡´
âœ“ æ•°æ®ç±»åž‹å¿…é¡»åŒ¹é…
âœ“ å¯é€‰å­—æ®µå¯ä»¥çœç•¥æˆ–è®¾ä¸ºnull

é”™è¯¯ç¤ºä¾‹ï¼š
âœ— {"id": 123, "name": "å¼ ä¸‰"}        // idåº”ä¸ºå­—ç¬¦ä¸²
âœ— {"user_id": "001", "name": "å¼ ä¸‰"} // å­—æ®µåä¸åŒ¹é…
âœ— {"id": "001", "age": "25"}        // ageåº”ä¸ºæ•°å­—
```

### 5.5 å¸¦é”®å€¼çš„ç”Ÿäº§è€…


**ðŸ”‘ é”®å€¼å¯¹Schemaå®šä¹‰**
```bash
# å‡†å¤‡é”®Schema
cat > key-schema.avsc << 'EOF'
{"type": "string"}
EOF

# ä½¿ç”¨é”®å€¼Schemaå¯åŠ¨ç”Ÿäº§è€…
bin/kafka-avro-console-producer \
  --bootstrap-server localhost:9092 \
  --topic user-avro-topic \
  --schema-registry-url http://localhost:8081 \
  --key-schema-file key-schema.avsc \
  --value-schema-file user-schema.avsc \
  --property parse.key=true \
  --property key.separator=:
```

**ðŸ“¤ é”®å€¼æ•°æ®è¾“å…¥**
```
"user_001":{"id": "001", "name": "å¼ ä¸‰", "age": 25}
"user_002":{"id": "002", "name": "æŽå››", "age": 30}
```

### 5.6 éªŒè¯æ•°æ®å‘é€


**ðŸ” ä½¿ç”¨Avroæ¶ˆè´¹è€…éªŒè¯**
```bash
bin/kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-avro-topic \
  --schema-registry-url http://localhost:8081 \
  --from-beginning
```

**ðŸ“Š æ£€æŸ¥Schema Registry**
```bash
# æŸ¥çœ‹å·²æ³¨å†Œçš„Schema
curl http://localhost:8081/subjects

# æŸ¥çœ‹ç‰¹å®šä¸»é¢˜çš„Schemaç‰ˆæœ¬
curl http://localhost:8081/subjects/user-avro-topic-value/versions
```

---

## 6. âš ï¸ é”™è¯¯å¤„ç†ä¸Žæ•…éšœæŽ’æŸ¥


### 6.1 å¸¸è§é”™è¯¯ç±»åž‹


**ðŸ”¸ è¿žæŽ¥ç›¸å…³é”™è¯¯**
```
é”™è¯¯ä¿¡æ¯ï¼šConnection refused to Schema Registry
åŽŸå› ï¼šSchema RegistryæœåŠ¡æœªå¯åŠ¨æˆ–åœ°å€é”™è¯¯
è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥Schema RegistryæœåŠ¡çŠ¶æ€
2. ç¡®è®¤ç«¯å£å·ï¼ˆé»˜è®¤8081ï¼‰
3. æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
```

**ðŸ”¸ Schemaç›¸å…³é”™è¯¯**
```
é”™è¯¯ä¿¡æ¯ï¼šSchema validation failed
åŽŸå› ï¼šæ•°æ®æ ¼å¼ä¸ŽSchemaå®šä¹‰ä¸åŒ¹é…
è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤å­—æ®µåç§°å’Œç±»åž‹åŒ¹é…
3. éªŒè¯å¿…éœ€å­—æ®µæ˜¯å¦å­˜åœ¨
```

**ðŸ”¸ æƒé™ç›¸å…³é”™è¯¯**
```
é”™è¯¯ä¿¡æ¯ï¼šUnauthorized access to Schema Registry
åŽŸå› ï¼šSchema Registryéœ€è¦è®¤è¯ä½†æœªæä¾›å‡­æ®
è§£å†³æ–¹æ¡ˆï¼š
1. æ·»åŠ è®¤è¯å‚æ•°
2. ç¡®è®¤ç”¨æˆ·åå¯†ç æ­£ç¡®
3. æ£€æŸ¥SSLé…ç½®
```

### 6.2 è°ƒè¯•æŠ€å·§


**ðŸ” æ—¥å¿—è°ƒè¯•**
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export KAFKA_OPTS="-Dlog4j.configuration=file:log4j.properties"

# æŸ¥çœ‹ç”Ÿäº§è€…æ—¥å¿—
tail -f logs/kafka-avro-console-producer.log
```

**ðŸ”§ è¿žæŽ¥æµ‹è¯•**
```bash
# æµ‹è¯•Schema Registryè¿žæŽ¥
curl -v http://localhost:8081/subjects

# æµ‹è¯•Kafkaè¿žæŽ¥
bin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092
```

### 6.3 å¸¸ç”¨æŽ’æŸ¥å‘½ä»¤


**ðŸ“‹ è¯Šæ–­å‘½ä»¤é›†åˆ**
```bash
# 1. æ£€æŸ¥ä¸»é¢˜æ˜¯å¦å­˜åœ¨
bin/kafka-topics.sh --list --bootstrap-server localhost:9092

# 2. æŸ¥çœ‹ä¸»é¢˜è¯¦ç»†ä¿¡æ¯
bin/kafka-topics.sh --describe --topic user-avro-topic \
  --bootstrap-server localhost:9092

# 3. æŸ¥çœ‹Schemaæ³¨å†Œæƒ…å†µ
curl http://localhost:8081/subjects/user-avro-topic-value/versions/latest

# 4. æµ‹è¯•æ¶ˆè´¹æ•°æ®
bin/kafka-avro-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic user-avro-topic \
  --schema-registry-url http://localhost:8081 \
  --from-beginning --max-messages 5
```

### 6.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ æ€§èƒ½è°ƒä¼˜å‚æ•°**
```bash
# æ‰¹å¤„ç†ä¼˜åŒ–
--property batch.size=16384
--property linger.ms=5

# åŽ‹ç¼©ä¼˜åŒ–
--property compression.type=snappy

# ç¼“å­˜ä¼˜åŒ–
--property schema.registry.cache.size=100
```

---

## 7. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ Avroç”Ÿäº§è€…ï¼šä¸“é—¨å¤„ç†ç»“æž„åŒ–æ•°æ®çš„Kafkaç”Ÿäº§è€…å·¥å…·
ðŸ”¸ Schema Registryï¼šé›†ä¸­ç®¡ç†Avroæ•°æ®æ ¼å¼å®šä¹‰çš„æœåŠ¡
ðŸ”¸ Schemaç‰ˆæœ¬æŽ§åˆ¶ï¼šæ”¯æŒæ•°æ®æ ¼å¼æ¼”è¿›çš„å…¼å®¹æ€§ç®¡ç†æœºåˆ¶
ðŸ”¸ åºåˆ—åŒ–é…ç½®ï¼šå°†ç»“æž„åŒ–æ•°æ®è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼çš„å‚æ•°è®¾ç½®
ðŸ”¸ å…¼å®¹æ€§æ£€æŸ¥ï¼šç¡®ä¿æ–°æ—§æ•°æ®æ ¼å¼èƒ½å¤Ÿæ­£å¸¸äº’æ“ä½œçš„éªŒè¯æœºåˆ¶
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ Avroçš„ä»·å€¼**
```
æ•°æ®æ ‡å‡†åŒ–ï¼š
â€¢ ç»Ÿä¸€çš„æ•°æ®æ ¼å¼å®šä¹‰ï¼Œé¿å…æ ¼å¼æ··ä¹±
â€¢ å¼ºåˆ¶æ•°æ®ç±»åž‹çº¦æŸï¼Œå‡å°‘è§£æžé”™è¯¯
â€¢ æ”¯æŒå¤æ‚æ•°æ®ç»“æž„ï¼Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚

ç‰ˆæœ¬æ¼”è¿›ï¼š
â€¢ è‡ªåŠ¨å¤„ç†æ•°æ®æ ¼å¼å˜æ›´
â€¢ ä¿è¯æ–°æ—§ç³»ç»Ÿçš„äº’æ“ä½œæ€§
â€¢ é™ä½Žç³»ç»Ÿå‡çº§çš„é£Žé™©å’Œæˆæœ¬

æ€§èƒ½ä¼˜åŒ–ï¼š
â€¢ äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œæ•°æ®ä½“ç§¯å°
â€¢ å¿«é€Ÿåºåˆ—åŒ–å’Œååºåˆ—åŒ–
â€¢ ç½‘ç»œä¼ è¾“æ•ˆçŽ‡é«˜
```

**ðŸ”¹ Schema Registryçš„é‡è¦æ€§**
```
é›†ä¸­ç®¡ç†ï¼š
â€¢ ç»Ÿä¸€å­˜å‚¨æ‰€æœ‰æ•°æ®æ ¼å¼å®šä¹‰
â€¢ é¿å…Schemaå®šä¹‰åˆ†æ•£å’Œä¸ä¸€è‡´
â€¢ ä¾¿äºŽå›¢é˜Ÿåä½œå’Œç»´æŠ¤

ç‰ˆæœ¬æŽ§åˆ¶ï¼š
â€¢ è‡ªåŠ¨ç®¡ç†Schemaç‰ˆæœ¬æ¼”è¿›
â€¢ æ”¯æŒå¤šç§å…¼å®¹æ€§ç­–ç•¥
â€¢ æä¾›ç‰ˆæœ¬å›žæ»šèƒ½åŠ›

è¿è¡Œæ—¶æ”¯æŒï¼š
â€¢ å®¢æˆ·ç«¯è‡ªåŠ¨èŽ·å–Schemaå®šä¹‰
â€¢ åŠ¨æ€åºåˆ—åŒ–å’Œååºåˆ—åŒ–
â€¢ å‡å°‘ç¡¬ç¼–ç ä¾èµ–
```

**ðŸ”¹ å‘½ä»¤ä½¿ç”¨æœ€ä½³å®žè·µ**
```
å¼€å‘é˜¶æ®µï¼š
â€¢ ä½¿ç”¨å†…è”Schemaå¿«é€Ÿæµ‹è¯•
â€¢ é¢‘ç¹éªŒè¯æ•°æ®æ ¼å¼æ­£ç¡®æ€§
â€¢ é€æ­¥å®Œå–„Schemaå®šä¹‰

ç”Ÿäº§éƒ¨ç½²ï¼š
â€¢ ä½¿ç”¨Schemaæ–‡ä»¶ç®¡ç†å¤æ‚å®šä¹‰
â€¢ é…ç½®è®¤è¯å’ŒSSLå®‰å…¨æŽªæ–½
â€¢ è®¾ç½®åˆé€‚çš„æ€§èƒ½å‚æ•°

ç»´æŠ¤é˜¶æ®µï¼š
â€¢ å®šæœŸæ£€æŸ¥Schemaå…¼å®¹æ€§
â€¢ ç›‘æŽ§åºåˆ—åŒ–æ€§èƒ½æŒ‡æ ‡
â€¢ åŠæ—¶å¤„ç†æ ¼å¼æ¼”è¿›éœ€æ±‚
```

### 7.3 å®žé™…åº”ç”¨æŒ‡å¯¼


**ðŸŽ¯ ä½¿ç”¨åœºæ™¯åˆ¤æ–­**
```
é€‚åˆä½¿ç”¨Avroçš„åœºæ™¯ï¼š
âœ… å¾®æœåŠ¡é—´æ•°æ®äº¤æ¢ï¼Œéœ€è¦æ ¼å¼æ ‡å‡†åŒ–
âœ… æ•°æ®ç®¡é“å¤„ç†ï¼Œè¦æ±‚é«˜æ€§èƒ½åºåˆ—åŒ–
âœ… æ•°æ®æ ¼å¼ä¼šé¢‘ç¹å˜æ›´ï¼Œéœ€è¦ç‰ˆæœ¬ç®¡ç†
âœ… å›¢é˜Ÿåä½œå¼€å‘ï¼Œéœ€è¦Schemaå…±äº«

ä¸é€‚åˆä½¿ç”¨Avroçš„åœºæ™¯ï¼š
âŒ ç®€å•æ–‡æœ¬æ¶ˆæ¯ï¼Œæ— ç»“æž„åŒ–éœ€æ±‚
âŒ ä¸€æ¬¡æ€§æ•°æ®ä¼ è¾“ï¼Œæ— å¤ç”¨ä»·å€¼
âŒ å®žæ—¶æ€§è¦æ±‚æžé«˜ï¼Œæ— æ³•æŽ¥å—SchemaæŸ¥è¯¢å»¶è¿Ÿ
âŒ å›¢é˜ŸæŠ€æœ¯æ ˆä¸æ”¯æŒAvro
```

**ðŸ”§ è¿ç»´å®žè·µè¦ç‚¹**
```
çŽ¯å¢ƒé…ç½®ï¼š
â€¢ ç¡®ä¿Schema Registryé«˜å¯ç”¨éƒ¨ç½²
â€¢ é…ç½®åˆé€‚çš„ç¼“å­˜å’Œè¿žæŽ¥æ± å¤§å°
â€¢ è®¾ç½®ç›‘æŽ§å’Œå‘Šè­¦æœºåˆ¶

Schemaç®¡ç†ï¼š
â€¢ å»ºç«‹Schemaå˜æ›´å®¡æ ¸æµç¨‹
â€¢ å®šæœŸæ¸…ç†æ— ç”¨çš„Schemaç‰ˆæœ¬
â€¢ ç»´æŠ¤Schemaæ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜Ž

æ•…éšœå¤„ç†ï¼š
â€¢ å‡†å¤‡å¸¸ç”¨è¯Šæ–­å‘½ä»¤å’Œè„šæœ¬
â€¢ å»ºç«‹Schemaå…¼å®¹æ€§é—®é¢˜å¤„ç†æµç¨‹
â€¢ å®šæœŸå¤‡ä»½Schema Registryæ•°æ®
```

### 7.4 å­¦ä¹ è·¯å¾„å»ºè®®


```
åˆå­¦é˜¶æ®µï¼š
1. ç†è§£AvroåŸºæœ¬æ¦‚å¿µå’Œåº”ç”¨ä»·å€¼
2. æŽŒæ¡ç®€å•Schemaå®šä¹‰å’ŒåŸºç¡€å‘½ä»¤
3. ç»ƒä¹ å‘é€å’ŒæŽ¥æ”¶Avroæ ¼å¼æ•°æ®

è¿›é˜¶é˜¶æ®µï¼š
1. å­¦ä¹ å¤æ‚Schemaè®¾è®¡å’Œç‰ˆæœ¬æ¼”è¿›
2. æŽŒæ¡Schema Registryç®¡ç†å’Œé…ç½®
3. äº†è§£å…¼å®¹æ€§ç­–ç•¥å’Œæœ€ä½³å®žè·µ

é«˜çº§é˜¶æ®µï¼š
1. æ·±å…¥ç†è§£åºåˆ—åŒ–åŽŸç†å’Œæ€§èƒ½ä¼˜åŒ–
2. è®¾è®¡ä¼ä¸šçº§Schemaç®¡ç†è§„èŒƒ
3. è§£å†³å¤æ‚çš„æ•°æ®æ ¼å¼æ¼”è¿›é—®é¢˜
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Avroæ ¼å¼æ•°æ®ç»“æž„ä¸¥ï¼ŒSchemaç®¡ç†ç‰ˆæœ¬å…¨
- æ³¨å†Œä¸­å¿ƒç»Ÿä¸€ç®¡ï¼Œå…¼å®¹æ£€æŸ¥ä¿å®‰å…¨  
- å‘½ä»¤å·¥å…·åŠŸèƒ½å¼ºï¼Œç”Ÿäº§æ¶ˆè´¹è¦é…å…¨
- é”™è¯¯æŽ’æŸ¥æœ‰æ–¹æ³•ï¼Œå®žè·µæ“ä½œæ˜¯å…³é”®