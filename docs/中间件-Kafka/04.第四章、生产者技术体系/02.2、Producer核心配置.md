---
title: 2ã€Produceræ ¸å¿ƒé…ç½®
---
## ğŸ“š ç›®å½•

1. [Produceré…ç½®æ¦‚è§ˆ](#1-Produceré…ç½®æ¦‚è§ˆ)
2. [è¿æ¥é…ç½®è¯¦è§£](#2-è¿æ¥é…ç½®è¯¦è§£)
3. [åºåˆ—åŒ–é…ç½®](#3-åºåˆ—åŒ–é…ç½®)
4. [å¯é æ€§é…ç½®](#4-å¯é æ€§é…ç½®)
5. [æ€§èƒ½ä¼˜åŒ–é…ç½®](#5-æ€§èƒ½ä¼˜åŒ–é…ç½®)
6. [é«˜çº§é…ç½®å‚æ•°](#6-é«˜çº§é…ç½®å‚æ•°)
7. [é…ç½®è°ƒä¼˜å®æˆ˜](#7-é…ç½®è°ƒä¼˜å®æˆ˜)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Produceré…ç½®æ¦‚è§ˆ


### 1.1 ä»€ä¹ˆæ˜¯Produceré…ç½®


**ç®€å•ç†è§£**ï¼šå°±åƒå¯„å¿«é€’éœ€è¦å¡«å†™å¿«é€’å•ä¸€æ ·ï¼ŒKafkaç”Ÿäº§è€…å‘é€æ¶ˆæ¯å‰ä¹Ÿéœ€è¦é…ç½®å„ç§å‚æ•°ï¼Œå‘Šè¯‰å®ƒæ€ä¹ˆå‘ã€å‘åˆ°å“ªé‡Œã€ç”¨ä»€ä¹ˆæ–¹å¼å‘ã€‚

```
ç°å®ç±»æ¯”ï¼š
å¯„å¿«é€’ â†’ Kafka Producer
æ”¶ä»¶åœ°å€ â†’ bootstrap.servers (Kafkaé›†ç¾¤åœ°å€)
åŒ…è£¹å†…å®¹ â†’ æ¶ˆæ¯å†…å®¹
å¯„é€æ–¹å¼ â†’ å„ç§é…ç½®å‚æ•°
```

### 1.2 é…ç½®å‚æ•°åˆ†ç±»


**ğŸ”¸ å¿…éœ€é…ç½®ï¼ˆä¸é…å°±è·‘ä¸èµ·æ¥ï¼‰**
- **bootstrap.servers**ï¼šå‘Šè¯‰Producerå»å“ªé‡Œæ‰¾Kafkaé›†ç¾¤
- **key.serializer**ï¼šé”®æ€ä¹ˆè½¬æ¢æˆå­—èŠ‚
- **value.serializer**ï¼šå€¼æ€ä¹ˆè½¬æ¢æˆå­—èŠ‚

**ğŸ”¸ é‡è¦é…ç½®ï¼ˆå½±å“å¯é æ€§å’Œæ€§èƒ½ï¼‰**
- **acks**ï¼šæ¶ˆæ¯ç¡®è®¤æœºåˆ¶
- **retries**ï¼šå¤±è´¥é‡è¯•æ¬¡æ•°
- **batch.size**ï¼šæ‰¹å¤„ç†å¤§å°

**ğŸ”¸ ä¼˜åŒ–é…ç½®ï¼ˆæå‡æ€§èƒ½ï¼‰**
- **linger.ms**ï¼šç­‰å¾…æ—¶é—´
- **buffer.memory**ï¼šç¼“å†²åŒºå¤§å°
- **compression.type**ï¼šå‹ç¼©æ–¹å¼

### 1.3 é…ç½®çš„é‡è¦æ€§


```
é…ç½®ä¸å½“çš„åæœï¼š
âŒ æ¶ˆæ¯ä¸¢å¤± â†’ acksè®¾ç½®è¿‡ä½
âŒ æ€§èƒ½å¾ˆå·® â†’ batch.sizeå¤ªå°
âŒ è¿æ¥å¤±è´¥ â†’ bootstrap.serversé”™è¯¯
âŒ å†…å­˜æº¢å‡º â†’ buffer.memoryå¤ªå°

åˆç†é…ç½®çš„å¥½å¤„ï¼š
âœ… æ¶ˆæ¯ä¸ä¸¢å¤± â†’ å¯é æ€§ä¿éšœ
âœ… é«˜ååé‡ â†’ æ€§èƒ½ä¼˜åŒ–
âœ… ç¨³å®šè¿è¡Œ â†’ èµ„æºåˆç†åˆ†é…
```

---

## 2. ğŸ”— è¿æ¥é…ç½®è¯¦è§£


### 2.1 bootstrap.servers - é›†ç¾¤åœ°å€é…ç½®


**ä½œç”¨è¯´æ˜**ï¼šå‘Šè¯‰Producerå»å“ªé‡Œæ‰¾Kafkaé›†ç¾¤ï¼Œå°±åƒGPSå¯¼èˆªçš„ç›®çš„åœ°åœ°å€ã€‚

**é…ç½®æ ¼å¼**ï¼š
```properties
# å•èŠ‚ç‚¹
bootstrap.servers=localhost:9092

# é›†ç¾¤ç¯å¢ƒï¼ˆæ¨èæ–¹å¼ï¼‰
bootstrap.servers=kafka1:9092,kafka2:9092,kafka3:9092
```

**ğŸ’¡ å…³é”®ç†è§£**ï¼š
- **ä¸éœ€è¦é…ç½®æ‰€æœ‰èŠ‚ç‚¹**ï¼šé…ç½®2-3ä¸ªèŠ‚ç‚¹å³å¯ï¼ŒProducerä¼šè‡ªåŠ¨å‘ç°å…¶ä»–èŠ‚ç‚¹
- **é«˜å¯ç”¨è€ƒè™‘**ï¼šé…ç½®å¤šä¸ªèŠ‚ç‚¹é˜²æ­¢å•ç‚¹æ•…éšœ
- **è´Ÿè½½å‡è¡¡**ï¼šProducerä¼šè‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„èŠ‚ç‚¹è¿æ¥

```
å·¥ä½œåŸç†å›¾ï¼š
Producer â†’ bootstrap.servers â†’ è·å–é›†ç¾¤å…ƒæ•°æ® â†’ è¿æ¥åˆ°å®é™…çš„åˆ†åŒºLeader

ç±»æ¯”ç†è§£ï¼š
å°±åƒé—®è·¯æ—¶ï¼Œä½ åªéœ€è¦çŸ¥é“å‡ ä¸ªä¸»è¦è·¯å£ï¼Œ
ç„¶åé¡ºç€è·¯æ ‡å°±èƒ½æ‰¾åˆ°æœ€ç»ˆç›®çš„åœ°
```

### 2.2 è¿æ¥ç›¸å…³é«˜çº§é…ç½®


**ğŸ”¸ è¿æ¥è¶…æ—¶é…ç½®**
```properties
# è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤40ç§’ï¼‰
connections.max.idle.ms=540000

# è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤30ç§’ï¼‰  
request.timeout.ms=30000
```

**å®é™…æ„ä¹‰**ï¼š
- **connections.max.idle.ms**ï¼šè¿æ¥ç©ºé—²å¤šé•¿æ—¶é—´åå…³é—­ï¼Œé¿å…èµ„æºæµªè´¹
- **request.timeout.ms**ï¼šå•ä¸ªè¯·æ±‚æœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œé˜²æ­¢æ— é™ç­‰å¾…

---

## 3. ğŸ”„ åºåˆ—åŒ–é…ç½®


### 3.1 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–


**é€šä¿—è§£é‡Š**ï¼šåºåˆ—åŒ–å°±æ˜¯æŠŠJavaå¯¹è±¡è½¬æ¢æˆå­—èŠ‚æ•°ç»„çš„è¿‡ç¨‹ï¼Œå°±åƒæŠŠç‰©å“æ‰“åŒ…è£…ç®±ä¸€æ ·ã€‚

```
ç°å®ç±»æ¯”ï¼š
å¯„å¿«é€’æ—¶éœ€è¦æ‰“åŒ… â†’ åºåˆ—åŒ–
æ”¶å¿«é€’æ—¶éœ€è¦æ‹†åŒ… â†’ ååºåˆ—åŒ–

Javaå¯¹è±¡ --åºåˆ—åŒ–--> å­—èŠ‚æ•°ç»„ --ç½‘ç»œä¼ è¾“--> Kafkaé›†ç¾¤
```

### 3.2 key.serializer - é”®åºåˆ—åŒ–å™¨


**é…ç½®è¯´æ˜**ï¼šæŒ‡å®šæ¶ˆæ¯é”®ï¼ˆkeyï¼‰å¦‚ä½•è½¬æ¢æˆå­—èŠ‚æ•°ç»„ã€‚

**å¸¸ç”¨åºåˆ—åŒ–å™¨**ï¼š
```properties
# å­—ç¬¦ä¸²åºåˆ—åŒ–å™¨ï¼ˆæœ€å¸¸ç”¨ï¼‰
key.serializer=org.apache.kafka.common.serialization.StringSerializer

# æ•´æ•°åºåˆ—åŒ–å™¨
key.serializer=org.apache.kafka.common.serialization.IntegerSerializer

# å­—èŠ‚æ•°ç»„åºåˆ—åŒ–å™¨
key.serializer=org.apache.kafka.common.serialization.ByteArraySerializer
```

**ğŸ’¡ é€‰æ‹©åŸåˆ™**ï¼š
- **Stringç±»å‹çš„key** â†’ StringSerializer
- **Integerç±»å‹çš„key** â†’ IntegerSerializer  
- **è‡ªå®šä¹‰å¯¹è±¡** â†’ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨æˆ–JSONåºåˆ—åŒ–å™¨

### 3.3 value.serializer - å€¼åºåˆ—åŒ–å™¨


**é…ç½®è¯´æ˜**ï¼šæŒ‡å®šæ¶ˆæ¯å€¼ï¼ˆvalueï¼‰å¦‚ä½•è½¬æ¢æˆå­—èŠ‚æ•°ç»„ã€‚

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```properties
# å‘é€å­—ç¬¦ä¸²æ¶ˆæ¯
value.serializer=org.apache.kafka.common.serialization.StringSerializer

# å‘é€JSONæ ¼å¼æ¶ˆæ¯  
value.serializer=org.apache.kafka.common.serialization.StringSerializer

# å‘é€Avroæ ¼å¼æ¶ˆæ¯
value.serializer=io.confluent.kafka.serializers.KafkaAvroSerializer
```

**ğŸ”¸ åºåˆ—åŒ–å™¨é€‰æ‹©å¯¹æ¯”**

| æ•°æ®ç±»å‹ | æ¨èåºåˆ—åŒ–å™¨ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---------|------------|------|------|
| **ç®€å•å­—ç¬¦ä¸²** | `StringSerializer` | ç®€å•æ˜“ç”¨ï¼Œäººç±»å¯è¯» | æ•°æ®é‡ç¨å¤§ |
| **JSONå¯¹è±¡** | `StringSerializer` + JSON | çµæ´»ï¼Œè·¨è¯­è¨€ | è§£æå¼€é”€ï¼Œæ— schemaéªŒè¯ |
| **Avroå¯¹è±¡** | `KafkaAvroSerializer` | é«˜æ•ˆï¼Œæœ‰schema | å­¦ä¹ æˆæœ¬é«˜ |
| **è‡ªå®šä¹‰å¯¹è±¡** | è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ | å®Œå…¨æ§åˆ¶ | å¼€å‘æˆæœ¬é«˜ |

---

## 4. âœ… å¯é æ€§é…ç½®


### 4.1 acks - ç¡®è®¤æœºåˆ¶ï¼ˆæœ€é‡è¦çš„å¯é æ€§é…ç½®ï¼‰


**ä½œç”¨è¯´æ˜**ï¼šå†³å®šProduceréœ€è¦ç­‰å¾…å¤šå°‘ä¸ªå‰¯æœ¬ç¡®è®¤æ¶ˆæ¯å†™å…¥æˆåŠŸã€‚

**ä¸‰ç§ç¡®è®¤çº§åˆ«**ï¼š

**ğŸ”¸ acks=0ï¼ˆä¸ç­‰å¾…ç¡®è®¤ï¼‰**
```properties
acks=0
```
- **å«ä¹‰**ï¼šå‘é€å®Œæ¶ˆæ¯å°±è®¤ä¸ºæˆåŠŸï¼Œä¸ç­‰ä»»ä½•ç¡®è®¤
- **ä¼˜ç‚¹**ï¼šæ€§èƒ½æœ€é«˜ï¼Œå»¶è¿Ÿæœ€ä½
- **ç¼ºç‚¹**ï¼šå¯èƒ½ä¸¢å¤±æ¶ˆæ¯
- **é€‚ç”¨åœºæ™¯**ï¼šå¯¹æ•°æ®ä¸¢å¤±ä¸æ•æ„Ÿçš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—æ”¶é›†

```
å·¥ä½œæµç¨‹ï¼š
Producer â†’ å‘é€æ¶ˆæ¯ â†’ ç«‹å³è¿”å›æˆåŠŸ
          |
          âœ— ä¸ç­‰å¾…Brokerç¡®è®¤
```

**ğŸ”¸ acks=1ï¼ˆç­‰å¾…Leaderç¡®è®¤ï¼‰**
```properties
acks=1
```
- **å«ä¹‰**ï¼šç­‰å¾…åˆ†åŒºLeaderå†™å…¥æˆåŠŸå³å¯
- **ä¼˜ç‚¹**ï¼šå¹³è¡¡æ€§èƒ½å’Œå¯é æ€§
- **ç¼ºç‚¹**ï¼šLeaderæ•…éšœå¯èƒ½ä¸¢æ¶ˆæ¯
- **é€‚ç”¨åœºæ™¯**ï¼šå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯çš„é»˜è®¤é€‰æ‹©

```
å·¥ä½œæµç¨‹ï¼š
Producer â†’ å‘é€æ¶ˆæ¯ â†’ Leaderå†™å…¥ â†’ è¿”å›ç¡®è®¤
                      |
                    âœ“ ç­‰å¾…Leaderç¡®è®¤
```

**ğŸ”¸ acks=allï¼ˆç­‰å¾…æ‰€æœ‰å‰¯æœ¬ç¡®è®¤ï¼‰**
```properties
acks=all
# æˆ–è€…å†™æˆ
acks=-1
```
- **å«ä¹‰**ï¼šç­‰å¾…æ‰€æœ‰åŒæ­¥å‰¯æœ¬ï¼ˆISRï¼‰éƒ½å†™å…¥æˆåŠŸ
- **ä¼˜ç‚¹**ï¼šæœ€é«˜å¯é æ€§ï¼Œä¸ä¼šä¸¢æ¶ˆæ¯
- **ç¼ºç‚¹**ï¼šæ€§èƒ½æœ€ä½ï¼Œå»¶è¿Ÿæœ€é«˜
- **é€‚ç”¨åœºæ™¯**ï¼šé‡‘èã€æ”¯ä»˜ç­‰å¯¹æ•°æ®è¦æ±‚æé«˜çš„åœºæ™¯

```
å·¥ä½œæµç¨‹ï¼š
Producer â†’ å‘é€æ¶ˆæ¯ â†’ Leaderå†™å…¥ â†’ FolloweråŒæ­¥ â†’ è¿”å›ç¡®è®¤
                      |            |
                    âœ“ ç­‰å¾…æ‰€æœ‰ISRå‰¯æœ¬ç¡®è®¤
```

### 4.2 retries - é‡è¯•æœºåˆ¶


**é…ç½®è¯´æ˜**ï¼šå½“æ¶ˆæ¯å‘é€å¤±è´¥æ—¶ï¼ŒProducerä¼šè‡ªåŠ¨é‡è¯•çš„æ¬¡æ•°ã€‚

```properties
# é‡è¯•æ¬¡æ•°ï¼ˆå»ºè®®è®¾ç½®è¾ƒå¤§å€¼ï¼‰
retries=2147483647

# é‡è¯•é—´éš”æ—¶é—´ï¼ˆé»˜è®¤100msï¼‰
retry.backoff.ms=100
```

**ğŸ’¡ é‡è¯•ç­–ç•¥ç†è§£**ï¼š
```
å‘é€å¤±è´¥ â†’ ç­‰å¾…100ms â†’ ç¬¬1æ¬¡é‡è¯• â†’ å¤±è´¥
          â†“
        ç­‰å¾…200ms â†’ ç¬¬2æ¬¡é‡è¯• â†’ å¤±è´¥  
          â†“
        ç­‰å¾…400ms â†’ ç¬¬3æ¬¡é‡è¯• â†’ æˆåŠŸ
```

**ğŸ”¸ é‡è¯•é…ç½®å»ºè®®**
- **retries**ï¼šè®¾ç½®ä¸ºæœ€å¤§å€¼ `Integer.MAX_VALUE`
- **retry.backoff.ms**ï¼šé»˜è®¤100msé€šå¸¸å¤Ÿç”¨
- **delivery.timeout.ms**ï¼šæ€»ä½“è¶…æ—¶æ—¶é—´æ§åˆ¶

### 4.3 enable.idempotence - å¹‚ç­‰æ€§é…ç½®


**å¹‚ç­‰æ€§å«ä¹‰**ï¼šæ— è®ºå‘é€å¤šå°‘æ¬¡ç›¸åŒçš„æ¶ˆæ¯ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ä¼šäº§ç”Ÿé‡å¤æ¶ˆæ¯ã€‚

```properties
# å¼€å¯å¹‚ç­‰æ€§ï¼ˆæ¨èå¼€å¯ï¼‰
enable.idempotence=true
```

**å¼€å¯å¹‚ç­‰æ€§çš„å¥½å¤„**ï¼š
- âœ… **é˜²æ­¢é‡å¤æ¶ˆæ¯**ï¼šç½‘ç»œæŠ–åŠ¨é‡è¯•ä¸ä¼šäº§ç”Ÿé‡å¤
- âœ… **ä¿è¯æ¶ˆæ¯é¡ºåº**ï¼šé¿å…ä¹±åºé—®é¢˜  
- âœ… **exactly-onceè¯­ä¹‰**ï¼šé…åˆäº‹åŠ¡ä½¿ç”¨

**æ³¨æ„äº‹é¡¹**ï¼šå¼€å¯å¹‚ç­‰æ€§ä¼šè‡ªåŠ¨è°ƒæ•´ä»¥ä¸‹é…ç½®ï¼š
```properties
retries=Integer.MAX_VALUE
max.in.flight.requests.per.connection=5
acks=all
```

---

## 5. ğŸš€ æ€§èƒ½ä¼˜åŒ–é…ç½®


### 5.1 batch.size - æ‰¹å¤„ç†å¤§å°


**ä½œç”¨åŸç†**ï¼šProducerä¼šæŠŠå¤šæ¡æ¶ˆæ¯æ‰“åŒ…æˆä¸€ä¸ªæ‰¹æ¬¡å‘é€ï¼Œæé«˜ååé‡ã€‚

```properties
# æ‰¹æ¬¡å¤§å°ï¼ˆé»˜è®¤16KBï¼‰
batch.size=16384

# å¤§æ•°æ®é‡åœºæ™¯å¯ä»¥è°ƒå¤§
batch.size=65536
```

**é€šä¿—ç†è§£**ï¼š
```
ç±»æ¯”å¿«é€’é…é€ï¼š
å•ä¸ªé…é€ï¼šæ¯æ¬¡é€1ä¸ªåŒ…è£¹ â†’ æ•ˆç‡ä½
æ‰¹é‡é…é€ï¼šæ¯æ¬¡é€10ä¸ªåŒ…è£¹ â†’ æ•ˆç‡é«˜

Kafkaæ‰¹æ¬¡å‘é€ï¼š
accumulator batch â†’ æ”¶é›†æ¶ˆæ¯ â†’ è¾¾åˆ°batch.size â†’ å‘é€
```

**ğŸ”¸ batch.sizeé…ç½®å»ºè®®**

| åœºæ™¯ | batch.size | è¯´æ˜ |
|------|-----------|------|
| **ä½å»¶è¿Ÿè¦æ±‚** | `1024-8192` | å°æ‰¹æ¬¡ï¼Œå¿«é€Ÿå‘é€ |
| **é«˜ååé‡** | `32768-65536` | å¤§æ‰¹æ¬¡ï¼Œæå‡æ•ˆç‡ |
| **é»˜è®¤åœºæ™¯** | `16384` | å¹³è¡¡å»¶è¿Ÿå’Œååé‡ |

### 5.2 linger.ms - å»¶è¿Ÿå‘é€æ—¶é—´


**ä½œç”¨è¯´æ˜**ï¼šProduceråœ¨å‘é€æ‰¹æ¬¡å‰ç­‰å¾…çš„æ—¶é—´ï¼Œè®©æ›´å¤šæ¶ˆæ¯ç§¯ç´¯åˆ°ä¸€ä¸ªæ‰¹æ¬¡ä¸­ã€‚

```properties
# ç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤0msï¼Œç«‹å³å‘é€ï¼‰
linger.ms=0

# æå‡ååé‡çš„è®¾ç½®ï¼ˆå¸¸ç”¨5-100msï¼‰
linger.ms=10
```

**å·¥ä½œæœºåˆ¶å›¾è§£**ï¼š
```
æ¶ˆæ¯1åˆ°è¾¾ â†’ å¯åŠ¨è®¡æ—¶å™¨(linger.ms) â†’ æ¶ˆæ¯2åˆ°è¾¾ â†’ æ¶ˆæ¯3åˆ°è¾¾ â†’ æ—¶é—´åˆ°/æ‰¹æ¬¡æ»¡ â†’ å‘é€
             |                          |            |               |
           ç­‰å¾…æ›´å¤šæ¶ˆæ¯                ç»§ç»­ç§¯ç´¯      ç»§ç»­ç§¯ç´¯        æ‰“åŒ…å‘é€
```

**ğŸ’¡ é…ç½®åŸåˆ™**ï¼š
- **linger.ms=0**ï¼šå®æ—¶æ€§è¦æ±‚é«˜ï¼Œç«‹å³å‘é€
- **linger.ms=5-10**ï¼šå¹³è¡¡å®æ—¶æ€§å’Œååé‡  
- **linger.ms=50-100**ï¼šå¤§æ•°æ®é‡åœºæ™¯ï¼Œæœ€å¤§åŒ–ååé‡

### 5.3 buffer.memory - ç¼“å†²å†…å­˜


**ä½œç”¨è¯´æ˜**ï¼šProducerç”¨æ¥ç¼“å­˜å¾…å‘é€æ¶ˆæ¯çš„å†…å­˜å¤§å°ã€‚

```properties
# ç¼“å†²å†…å­˜å¤§å°ï¼ˆé»˜è®¤32MBï¼‰
buffer.memory=33554432

# é«˜å¹¶å‘åœºæ™¯å»ºè®®è°ƒå¤§
buffer.memory=67108864
```

**å†…å­˜ä½¿ç”¨åŸç†**ï¼š
```
åº”ç”¨ç¨‹åºå‘é€æ¶ˆæ¯ â†’ æ¶ˆæ¯è¿›å…¥buffer.memory â†’ åå°çº¿ç¨‹å‘é€åˆ°Kafka
                    |                      |
                 ç¼“å†²åŒºæ»¡äº†ä¼šé˜»å¡          å¼‚æ­¥å‘é€æå‡æ€§èƒ½
```

**ğŸ”¸ å†…å­˜é…ç½®ç­–ç•¥**

| å‘é€é¢‘ç‡ | buffer.memory | åŸå› è¯´æ˜ |
|---------|--------------|----------|
| **ä½é¢‘å‘é€** | `32MBï¼ˆé»˜è®¤ï¼‰` | é»˜è®¤å€¼å¤Ÿç”¨ |
| **é«˜é¢‘å‘é€** | `64MB-128MB` | é¿å…é˜»å¡ï¼Œæå‡æ€§èƒ½ |
| **è¶…é«˜å¹¶å‘** | `256MB+` | å¤§ç¼“å†²åŒºåº”å¯¹çªå‘æµé‡ |

### 5.4 compression.type - å‹ç¼©é…ç½®


**ä½œç”¨è¯´æ˜**ï¼šå¯¹æ¶ˆæ¯è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“å’Œå­˜å‚¨ç©ºé—´ã€‚

```properties
# ä¸å‹ç¼©ï¼ˆé»˜è®¤ï¼‰
compression.type=none

# å¸¸ç”¨å‹ç¼©ç®—æ³•
compression.type=gzip    # å‹ç¼©ç‡é«˜ï¼ŒCPUæ¶ˆè€—ä¸­ç­‰
compression.type=lz4     # å‹ç¼©é€Ÿåº¦å¿«ï¼ŒCPUæ¶ˆè€—ä½  
compression.type=snappy  # å¹³è¡¡å‹ç¼©ç‡å’Œé€Ÿåº¦
compression.type=zstd    # æœ€æ–°ç®—æ³•ï¼Œæ•ˆæœæœ€å¥½
```

**ğŸ”¸ å‹ç¼©ç®—æ³•å¯¹æ¯”**

| å‹ç¼©ç®—æ³• | å‹ç¼©ç‡ | å‹ç¼©é€Ÿåº¦ | CPUæ¶ˆè€— | é€‚ç”¨åœºæ™¯ |
|---------|-------|---------|---------|----------|
| **gzip** | ğŸŸ¢é«˜ | ğŸŸ¡ä¸­ç­‰ | ğŸŸ¡ä¸­ç­‰ | ç½‘ç»œå¸¦å®½æœ‰é™ |
| **lz4** | ğŸŸ¡ä¸­ç­‰ | ğŸŸ¢å¿« | ğŸŸ¢ä½ | å®æ—¶æ€§è¦æ±‚é«˜ |
| **snappy** | ğŸŸ¡ä¸­ç­‰ | ğŸŸ¢å¿« | ğŸŸ¢ä½ | é€šç”¨åœºæ™¯ |
| **zstd** | ğŸŸ¢é«˜ | ğŸŸ¢å¿« | ğŸŸ¡ä¸­ç­‰ | æœ€ä½³é€‰æ‹©ï¼ˆæ–°ç‰ˆæœ¬ï¼‰ |

---

## 6. âš™ï¸ é«˜çº§é…ç½®å‚æ•°


### 6.1 max.in.flight.requests.per.connection


**é…ç½®å«ä¹‰**ï¼šProducerå‘å•ä¸ªè¿æ¥å‘é€çš„æœªç¡®è®¤è¯·æ±‚çš„æœ€å¤§æ•°é‡ã€‚

```properties
# é»˜è®¤å€¼ä¸º5
max.in.flight.requests.per.connection=5

# ä¸¥æ ¼ä¿è¯é¡ºåºæ—¶è®¾ä¸º1
max.in.flight.requests.per.connection=1
```

**é€šä¿—ç†è§£**ï¼š
```
ç±»æ¯”ç†è§£ï¼š
å°±åƒé“¶è¡Œçª—å£ï¼ŒåŒæ—¶èƒ½å¤„ç†5ä¸ªå®¢æˆ·çš„ä¸šåŠ¡
å¦‚æœè®¾ç½®ä¸º1ï¼Œå°±æ˜¯ä¸€ä¸ªå®¢æˆ·åŠå®Œæ‰èƒ½åŠä¸‹ä¸€ä¸ª

Producerè¿æ¥ â†’ å¯ä»¥åŒæ—¶å‘é€5ä¸ªæ‰¹æ¬¡ â†’ Brokerå¤„ç†
              |                    |
           æå‡å¹¶å‘æ€§èƒ½              å¯èƒ½ä¹±åº
```

**ğŸ”¸ é…ç½®é€‰æ‹©æŒ‡å¯¼**
- **max.in.flight=1**ï¼šä¸¥æ ¼ä¿è¯æ¶ˆæ¯é¡ºåºï¼Œæ€§èƒ½ç¨ä½
- **max.in.flight=5**ï¼šé«˜æ€§èƒ½ï¼Œé…åˆå¹‚ç­‰æ€§ä½¿ç”¨
- **max.in.flight>5**ï¼šä¸€èˆ¬ä¸å»ºè®®ï¼Œå¯èƒ½å½±å“ç¨³å®šæ€§

### 6.2 delivery.timeout.ms - äº¤ä»˜è¶…æ—¶


**é…ç½®è¯´æ˜**ï¼šProducerç­‰å¾…æ¶ˆæ¯äº¤ä»˜æˆåŠŸçš„æœ€é•¿æ—¶é—´ã€‚

```properties
# æ€»ä½“äº¤ä»˜è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤2åˆ†é’Ÿï¼‰
delivery.timeout.ms=120000

# ç”Ÿäº§ç¯å¢ƒå»ºè®®é€‚å½“è°ƒå¤§
delivery.timeout.ms=300000
```

**è¶…æ—¶æ—¶é—´å…³ç³»**ï¼š
```
delivery.timeout.ms â‰¥ linger.ms + request.timeout.ms

æ€»äº¤ä»˜æ—¶é—´ = ç­‰å¾…æ‰¹æ¬¡æ—¶é—´ + ç½‘ç»œä¼ è¾“æ—¶é—´ + é‡è¯•æ—¶é—´
```

### 6.3 metadata.max.age.ms - å…ƒæ•°æ®åˆ·æ–°


**é…ç½®è¯´æ˜**ï¼šProducerå¤šä¹…åˆ·æ–°ä¸€æ¬¡Kafkaé›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚

```properties
# å…ƒæ•°æ®åˆ·æ–°é—´éš”ï¼ˆé»˜è®¤5åˆ†é’Ÿï¼‰
metadata.max.age.ms=300000
```

**ä¸ºä»€ä¹ˆéœ€è¦åˆ·æ–°å…ƒæ•°æ®**ï¼š
- ğŸ”„ **åˆ†åŒºLeaderå˜æ›´**ï¼šæ•…éšœè½¬ç§»åéœ€è¦çŸ¥é“æ–°Leader
- ğŸ”„ **åˆ†åŒºæ•°é‡å˜åŒ–**ï¼šTopicå¢åŠ åˆ†åŒºåéœ€è¦æ›´æ–°
- ğŸ”„ **é›†ç¾¤èŠ‚ç‚¹å˜åŒ–**ï¼šæ–°å¢æˆ–ä¸‹çº¿èŠ‚ç‚¹

---

## 7. ğŸ¯ é…ç½®è°ƒä¼˜å®æˆ˜


### 7.1 é«˜ååé‡ä¼˜åŒ–é…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šå¤§æ•°æ®æ‰¹å¤„ç†ã€æ—¥å¿—æ”¶é›†ç³»ç»Ÿ

```properties
# åŸºç¡€é…ç½®
bootstrap.servers=kafka1:9092,kafka2:9092,kafka3:9092
key.serializer=org.apache.kafka.common.serialization.StringSerializer
value.serializer=org.apache.kafka.common.serialization.StringSerializer

# ååé‡ä¼˜åŒ–
acks=1                                    # å¹³è¡¡å¯é æ€§å’Œæ€§èƒ½
batch.size=65536                          # å¢å¤§æ‰¹æ¬¡å¤§å°
linger.ms=20                             # ç­‰å¾…æ›´å¤šæ¶ˆæ¯
buffer.memory=134217728                   # å¢å¤§ç¼“å†²åŒº(128MB)
compression.type=lz4                      # ä½¿ç”¨å¿«é€Ÿå‹ç¼©
max.in.flight.requests.per.connection=5   # æé«˜å¹¶å‘åº¦
```

**é¢„æœŸæ•ˆæœ**ï¼š
- âš¡ ååé‡æå‡ **50-100%**
- ğŸ“Š æ¯ç§’å¤„ç† **100ä¸‡+** æ¶ˆæ¯
- ğŸ’¾ ç½‘ç»œä½¿ç”¨ç‡é™ä½ **30-50%**

### 7.2 ä½å»¶è¿Ÿä¼˜åŒ–é…ç½®  


**é€‚ç”¨åœºæ™¯**ï¼šå®æ—¶äº¤æ˜“ç³»ç»Ÿã€åœ¨çº¿æ¸¸æˆã€å®æ—¶ç›‘æ§

```properties
# åŸºç¡€é…ç½®
bootstrap.servers=kafka1:9092,kafka2:9092,kafka3:9092
key.serializer=org.apache.kafka.common.serialization.StringSerializer
value.serializer=org.apache.kafka.common.serialization.StringSerializer

# ä½å»¶è¿Ÿä¼˜åŒ–
acks=1                                    # é¿å…ç­‰å¾…æ‰€æœ‰å‰¯æœ¬
batch.size=1024                          # å‡å°æ‰¹æ¬¡å¤§å°
linger.ms=0                              # ç«‹å³å‘é€
buffer.memory=33554432                    # é»˜è®¤ç¼“å†²åŒºå³å¯
compression.type=none                     # ä¸å‹ç¼©å‡å°‘CPUå¼€é”€
max.in.flight.requests.per.connection=1  # ä¿è¯é¡ºåº
```

**é¢„æœŸæ•ˆæœ**ï¼š
- â±ï¸ ç«¯åˆ°ç«¯å»¶è¿Ÿ **< 10ms**
- ğŸ¯ 99.9%è¯·æ±‚å»¶è¿Ÿ **< 50ms**
- ğŸ“ˆ ä¸¥æ ¼ä¿è¯æ¶ˆæ¯é¡ºåº

### 7.3 é«˜å¯é æ€§é…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šé‡‘èæ”¯ä»˜ã€è®¢å•ç³»ç»Ÿã€å…³é”®ä¸šåŠ¡æ•°æ®

```properties
# åŸºç¡€é…ç½®
bootstrap.servers=kafka1:9092,kafka2:9092,kafka3:9092
key.serializer=org.apache.kafka.common.serialization.StringSerializer  
value.serializer=org.apache.kafka.common.serialization.StringSerializer

# é«˜å¯é æ€§é…ç½®
acks=all                                  # ç­‰å¾…æ‰€æœ‰å‰¯æœ¬ç¡®è®¤
retries=2147483647                        # æœ€å¤§é‡è¯•æ¬¡æ•°
retry.backoff.ms=100                      # é‡è¯•é—´éš”
enable.idempotence=true                   # å¼€å¯å¹‚ç­‰æ€§
delivery.timeout.ms=300000                # 5åˆ†é’Ÿäº¤ä»˜è¶…æ—¶
batch.size=16384                          # é€‚ä¸­æ‰¹æ¬¡å¤§å°
linger.ms=5                              # å°å»¶è¿Ÿç§¯ç´¯
```

**é¢„æœŸæ•ˆæœ**ï¼š  
- ğŸ”’ æ¶ˆæ¯ä¸¢å¤±ç‡ **æ¥è¿‘0**
- âœ… ä¸¥æ ¼ exactly-once è¯­ä¹‰
- ğŸ›¡ï¸ è‡ªåŠ¨æ•…éšœæ¢å¤

### 7.4 é…ç½®è°ƒä¼˜å†³ç­–çŸ©é˜µ


| ä¸šåŠ¡åœºæ™¯ | acks | batch.size | linger.ms | compression | é‡ç‚¹å…³æ³¨ |
|---------|------|-----------|-----------|-------------|----------|
| **å®æ—¶äº¤æ˜“** | `1` | `1024` | `0` | `none` | å»¶è¿Ÿæœ€ä½ |
| **æ—¥å¿—æ”¶é›†** | `1` | `65536` | `50` | `lz4` | ååé‡æœ€é«˜ |
| **æ”¯ä»˜è®¢å•** | `all` | `16384` | `5` | `gzip` | å¯é æ€§æœ€é«˜ |
| **ä¸€èˆ¬ä¸šåŠ¡** | `1` | `16384` | `10` | `snappy` | å¹³è¡¡å„æ–¹é¢ |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„é…ç½®


```
ğŸ”¸ è¿æ¥é…ç½®ï¼šbootstrap.servers - å‘Šè¯‰Producerå»å“ªæ‰¾Kafka
ğŸ”¸ åºåˆ—åŒ–ï¼škey/value.serializer - æ•°æ®å¦‚ä½•è½¬æ¢æˆå­—èŠ‚
ğŸ”¸ ç¡®è®¤æœºåˆ¶ï¼šacks - å†³å®šæ¶ˆæ¯çš„å¯é æ€§çº§åˆ«
ğŸ”¸ é‡è¯•é…ç½®ï¼šretries - å¤±è´¥åå¦‚ä½•è‡ªåŠ¨é‡è¯•
ğŸ”¸ æ‰¹å¤„ç†ï¼šbatch.size + linger.ms - å½±å“ååé‡å’Œå»¶è¿Ÿ
ğŸ”¸ å†…å­˜é…ç½®ï¼šbuffer.memory - ç¼“å­˜å¾…å‘é€æ¶ˆæ¯
```

### 8.2 é…ç½®è°ƒä¼˜åŸåˆ™


**ğŸ”¹ æŒ‰åœºæ™¯é€‰æ‹©ç­–ç•¥**
```
é«˜ååé‡åœºæ™¯ï¼š
- batch.sizeè°ƒå¤§ (32KB-64KB)
- linger.msé€‚ä¸­ (10-50ms)  
- compression.type=lz4

ä½å»¶è¿Ÿåœºæ™¯ï¼š
- batch.sizeè°ƒå° (1KB-4KB)
- linger.ms=0 (ç«‹å³å‘é€)
- compression.type=none

é«˜å¯é æ€§åœºæ™¯ï¼š
- acks=all
- enable.idempotence=true
- retries=MAX_VALUE
```

**ğŸ”¹ é…ç½®å‚æ•°ç›¸äº’å½±å“**
```
å¼€å¯idempotenceåè‡ªåŠ¨è®¾ç½®ï¼š
- acks=all  
- retries=MAX_VALUE
- max.in.flight.requests.per.connectionâ‰¤5

è°ƒå¤§batch.sizeéœ€è¦åŒæ—¶è€ƒè™‘ï¼š
- buffer.memoryæ˜¯å¦è¶³å¤Ÿ
- linger.msæ˜¯å¦éœ€è¦è°ƒæ•´
- å»¶è¿Ÿè¦æ±‚æ˜¯å¦èƒ½æ¥å—
```

### 8.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ”§ é€šç”¨æ¨èé…ç½®**
```properties
# è¿æ¥å’Œåºåˆ—åŒ–
bootstrap.servers=kafka1:9092,kafka2:9092,kafka3:9092
key.serializer=org.apache.kafka.common.serialization.StringSerializer
value.serializer=org.apache.kafka.common.serialization.StringSerializer

# å¯é æ€§ä¿éšœ
acks=1
retries=2147483647  
enable.idempotence=true

# æ€§èƒ½å¹³è¡¡
batch.size=16384
linger.ms=10
buffer.memory=67108864
compression.type=snappy

# è¶…æ—¶æ§åˆ¶
delivery.timeout.ms=300000
request.timeout.ms=30000
```

**ğŸ“Š ç›‘æ§æŒ‡æ ‡å…³æ³¨**
- **å‘é€æˆåŠŸç‡**ï¼šé¿å…æ¶ˆæ¯ä¸¢å¤±
- **å¹³å‡å»¶è¿Ÿ**ï¼šæ»¡è¶³ä¸šåŠ¡éœ€æ±‚
- **ååé‡**ï¼šè¾¾åˆ°æ€§èƒ½ç›®æ ‡
- **ç¼“å†²åŒºä½¿ç”¨ç‡**ï¼šé¿å…å†…å­˜ä¸è¶³

### 8.4 å¸¸è§é…ç½®é”™è¯¯


```
âŒ å¸¸è§é”™è¯¯1ï¼šacks=0ç”¨äºé‡è¦ä¸šåŠ¡
â†’ âœ… é‡è¦æ•°æ®è‡³å°‘ç”¨acks=1

âŒ å¸¸è§é”™è¯¯2ï¼šbatch.sizeè®¾ç½®è¿‡å°
â†’ âœ… æ ¹æ®æ¶ˆæ¯å¤§å°åˆç†è®¾ç½®

âŒ å¸¸è§é”™è¯¯3ï¼šbuffer.memoryè¿‡å°å¯¼è‡´é˜»å¡
â†’ âœ… ç›‘æ§ç¼“å†²åŒºä½¿ç”¨ç‡ï¼ŒåŠæ—¶è°ƒæ•´

âŒ å¸¸è§é”™è¯¯4ï¼šå¿½ç•¥delivery.timeout.msè®¾ç½®
â†’ âœ… è®¾ç½®åˆç†è¶…æ—¶é¿å…æ— é™ç­‰å¾…
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Produceré…ç½®å†³å®šäº†æ¶ˆæ¯çš„å¯é æ€§ã€æ€§èƒ½å’Œä¸€è‡´æ€§
- acksæ˜¯å¯é æ€§çš„æ ¸å¿ƒï¼Œbatch.sizeå’Œlinger.mså½±å“æ€§èƒ½
- ä¸åŒä¸šåŠ¡åœºæ™¯éœ€è¦ä¸åŒçš„é…ç½®ç­–ç•¥
- é…ç½®å‚æ•°ä¹‹é—´ç›¸äº’å½±å“ï¼Œéœ€è¦æ•´ä½“è€ƒè™‘
- ç”Ÿäº§ç¯å¢ƒè¦ç›‘æ§å…³é”®æŒ‡æ ‡ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒä¼˜