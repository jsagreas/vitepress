---
title: 3ã€æ¶ˆæ¯åºåˆ—åŒ–æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [æ¶ˆæ¯åºåˆ—åŒ–åŸºç¡€æ¦‚å¿µ](#1-æ¶ˆæ¯åºåˆ—åŒ–åŸºç¡€æ¦‚å¿µ)
2. [åºåˆ—åŒ–å™¨æ¥å£æ·±å…¥ç†è§£](#2-åºåˆ—åŒ–å™¨æ¥å£æ·±å…¥ç†è§£)
3. [Kafkaå†…ç½®åºåˆ—åŒ–å™¨è¯¦è§£](#3-Kafkaå†…ç½®åºåˆ—åŒ–å™¨è¯¦è§£)
4. [é«˜çº§åºåˆ—åŒ–æ–¹æ¡ˆ](#4-é«˜çº§åºåˆ—åŒ–æ–¹æ¡ˆ)
5. [è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¼€å‘](#5-è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¼€å‘)
6. [Schema Registryé›†æˆå®è·µ](#6-Schema-Registryé›†æˆå®è·µ)
7. [åºåˆ—åŒ–æ€§èƒ½ä¼˜åŒ–ä¸å¯¹æ¯”](#7-åºåˆ—åŒ–æ€§èƒ½ä¼˜åŒ–ä¸å¯¹æ¯”)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ æ¶ˆæ¯åºåˆ—åŒ–åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯åºåˆ—åŒ–


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ è¦æŠŠä¸€æœ¬ä¹¦å¯„ç»™è¿œæ–¹çš„æœ‹å‹
```
åŸå§‹çŠ¶æ€ï¼šä¸€æœ¬å®Œæ•´çš„å®ä½“ä¹¦ï¼ˆJavaå¯¹è±¡ï¼‰
           â†“
åºåˆ—åŒ–ï¼š   æŠŠä¹¦æ‹†è§£æˆæ–‡å­—ï¼Œå†™åœ¨çº¸ä¸Šï¼ˆå­—èŠ‚æ•°ç»„ï¼‰
           â†“
ç½‘ç»œä¼ è¾“ï¼š é€šè¿‡é‚®å±€å¯„é€è¿™äº›æ–‡å­—çº¸å¼ 
           â†“
ååºåˆ—åŒ–ï¼š æœ‹å‹æ”¶åˆ°åï¼Œé‡æ–°è£…è®¢æˆå®Œæ•´çš„ä¹¦ï¼ˆè¿˜åŸJavaå¯¹è±¡ï¼‰
```

**æŠ€æœ¯å®šä¹‰**ï¼š
- **åºåˆ—åŒ–**ï¼šå°†Javaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„çš„è¿‡ç¨‹
- **ååºåˆ—åŒ–**ï¼šå°†å­—èŠ‚æ•°ç»„è½¬æ¢å›Javaå¯¹è±¡çš„è¿‡ç¨‹
- **ç›®çš„**ï¼šè®©æ•°æ®èƒ½å¤Ÿåœ¨ç½‘ç»œä¸­ä¼ è¾“å’Œå­˜å‚¨

### 1.2 ä¸ºä»€ä¹ˆKafkaéœ€è¦åºåˆ—åŒ–


**æ ¸å¿ƒåŸå› **ï¼šKafkaåªèƒ½ä¼ è¾“å­—èŠ‚æ•°æ®

```
ç”Ÿäº§è€…ç«¯ï¼š
Javaå¯¹è±¡ â†’ åºåˆ—åŒ–å™¨ â†’ å­—èŠ‚æ•°ç»„ â†’ Kafkaé›†ç¾¤

æ¶ˆè´¹è€…ç«¯ï¼š
Kafkaé›†ç¾¤ â†’ å­—èŠ‚æ•°ç»„ â†’ ååºåˆ—åŒ–å™¨ â†’ Javaå¯¹è±¡
```

**å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š
- å‘é€ç”¨æˆ·ä¿¡æ¯ï¼š`Userå¯¹è±¡` â†’ `å­—èŠ‚æ•°ç»„` â†’ Kafka â†’ `å­—èŠ‚æ•°ç»„` â†’ `Userå¯¹è±¡`
- å‘é€è®¢å•æ•°æ®ï¼š`Orderå¯¹è±¡` â†’ `å­—èŠ‚æ•°ç»„` â†’ Kafka â†’ `å­—èŠ‚æ•°ç»„` â†’ `Orderå¯¹è±¡`

### 1.3 åºåˆ—åŒ–çš„å…³é”®ç‰¹æ€§


| ç‰¹æ€§ | è¯´æ˜ | é‡è¦æ€§ |
|------|------|--------|
| **å¯é€†æ€§** | `èƒ½å¤Ÿå®Œæ•´è¿˜åŸåŸå§‹æ•°æ®` | â­â­â­â­â­ |
| **æ€§èƒ½** | `åºåˆ—åŒ–/ååºåˆ—åŒ–é€Ÿåº¦` | â­â­â­â­ |
| **ç©ºé—´æ•ˆç‡** | `åºåˆ—åŒ–åæ•°æ®å¤§å°` | â­â­â­â­ |
| **å…¼å®¹æ€§** | `ç‰ˆæœ¬å‡çº§æ—¶çš„å‘åå…¼å®¹` | â­â­â­â­ |
| **è·¨è¯­è¨€** | `ä¸åŒè¯­è¨€é—´çš„äº’é€šæ€§` | â­â­â­ |

---

## 2. ğŸ› ï¸ åºåˆ—åŒ–å™¨æ¥å£æ·±å…¥ç†è§£


### 2.1 Serializeræ¥å£è§£æ


**æ¥å£å®šä¹‰**ï¼šæ‰€æœ‰åºåˆ—åŒ–å™¨éƒ½å¿…é¡»å®ç°è¿™ä¸ªæ¥å£

```java
public interface Serializer<T> extends Closeable, Configurable {
    // é…ç½®åºåˆ—åŒ–å™¨ï¼ˆåˆå§‹åŒ–æ—¶è°ƒç”¨ï¼‰
    void configure(Map<String, ?> configs, boolean isKey);
    
    // æ ¸å¿ƒæ–¹æ³•ï¼šå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
    byte[] serialize(String topic, T data);
    
    // å…³é—­èµ„æº
    void close();
}
```

**æ–¹æ³•è¯¦è§£**ï¼š

**ğŸ”¸ configureæ–¹æ³•**
```java
// ä½œç”¨ï¼šåˆå§‹åŒ–åºåˆ—åŒ–å™¨é…ç½®
// å‚æ•°ï¼šconfigs - é…ç½®å‚æ•°ï¼ŒisKey - æ˜¯å¦ç”¨äºkeyåºåˆ—åŒ–
// è°ƒç”¨æ—¶æœºï¼šProduceråˆ›å»ºæ—¶è‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡

void configure(Map<String, ?> configs, boolean isKey) {
    // è¿™é‡Œå¯ä»¥è¯»å–é…ç½®å‚æ•°
    // ä¾‹å¦‚ï¼šç¼–ç æ ¼å¼ã€å‹ç¼©ç®—æ³•ç­‰
}
```

**ğŸ”¸ serializeæ–¹æ³•**
```java
// ä½œç”¨ï¼šå®é™…çš„åºåˆ—åŒ–é€»è¾‘
// å‚æ•°ï¼štopic - ç›®æ ‡ä¸»é¢˜ï¼Œdata - è¦åºåˆ—åŒ–çš„å¯¹è±¡
// è¿”å›ï¼šåºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„
// è°ƒç”¨æ—¶æœºï¼šæ¯æ¬¡å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨

byte[] serialize(String topic, T data) {
    if (data == null) return null;
    // å®ç°å…·ä½“çš„åºåˆ—åŒ–é€»è¾‘
}
```

### 2.2 åºåˆ—åŒ–å™¨çš„å·¥ä½œæµç¨‹


```
Producerå‘é€æ¶ˆæ¯æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Javaå¯¹è±¡       â”‚
â”‚   (User, Order) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è°ƒç”¨serialize   â”‚
â”‚      æ–¹æ³•       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   byte[]æ•°ç»„    â”‚ â”€â”€â†’ å‘é€åˆ°Kafka
â”‚  [01,02,03...]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸ“¦ Kafkaå†…ç½®åºåˆ—åŒ–å™¨è¯¦è§£


### 3.1 åŸºç¡€ç±»å‹åºåˆ—åŒ–å™¨


**StringSerializerï¼ˆæœ€å¸¸ç”¨ï¼‰**

```java
// ä½¿ç”¨ç¤ºä¾‹
Properties props = new Properties();
props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");

// å‘é€å­—ç¬¦ä¸²æ¶ˆæ¯
producer.send(new ProducerRecord<>("my-topic", "hello", "world"));
```

**ğŸ”¸ å†…éƒ¨å·¥ä½œåŸç†**
```java
// StringSerializerçš„æ ¸å¿ƒå®ç°
public byte[] serialize(String topic, String data) {
    if (data == null) return null;
    return data.getBytes(StandardCharsets.UTF_8); // ä½¿ç”¨UTF-8ç¼–ç 
}
```

**å…¶ä»–åŸºç¡€ç±»å‹åºåˆ—åŒ–å™¨**ï¼š

| åºåˆ—åŒ–å™¨ | é€‚ç”¨æ•°æ®ç±»å‹ | ä½¿ç”¨åœºæ™¯ |
|---------|-------------|----------|
| `IntegerSerializer` | `Integeræ•°å€¼` | ç”¨æˆ·IDã€è®¡æ•°å™¨ |
| `LongSerializer` | `Longæ•°å€¼` | æ—¶é—´æˆ³ã€å¤§æ•°å€¼ |
| `DoubleSerializer` | `Doubleæ•°å€¼` | ä»·æ ¼ã€ç™¾åˆ†æ¯” |
| `ByteArraySerializer` | `å­—èŠ‚æ•°ç»„` | æ–‡ä»¶ã€å›¾ç‰‡æ•°æ® |

### 3.2 å†…ç½®åºåˆ—åŒ–å™¨çš„ä½¿ç”¨æŠ€å·§


**é€‰æ‹©åˆé€‚çš„åºåˆ—åŒ–å™¨**ï¼š

```java
// ç”¨æˆ·IDä½œä¸ºkeyï¼Œç”¨æˆ·ä¿¡æ¯ä½œä¸ºvalue
Properties props = new Properties();

// ç”¨æˆ·IDæ˜¯æ•´æ•°ç±»å‹
props.put("key.serializer", "org.apache.kafka.common.serialization.IntegerSerializer");

// ç”¨æˆ·ä¿¡æ¯ç”¨JSONå­—ç¬¦ä¸²è¡¨ç¤º
props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");

// å‘é€ç¤ºä¾‹
producer.send(new ProducerRecord<>("users", 12345, "{\"name\":\"å¼ ä¸‰\"}"));
```

### 3.3 å†…ç½®åºåˆ—åŒ–å™¨çš„å±€é™æ€§


**âš ï¸ ä¸»è¦é—®é¢˜**ï¼š
- **åªèƒ½å¤„ç†ç®€å•ç±»å‹**ï¼šæ— æ³•ç›´æ¥åºåˆ—åŒ–å¤æ‚å¯¹è±¡
- **ç¼ºä¹ç‰ˆæœ¬æ§åˆ¶**ï¼šæ•°æ®ç»“æ„å˜åŒ–æ—¶å®¹æ˜“å‡ºé—®é¢˜
- **æ€§èƒ½é™åˆ¶**ï¼šå­—ç¬¦ä¸²åºåˆ—åŒ–æ•ˆç‡ç›¸å¯¹è¾ƒä½
- **æ•°æ®è†¨èƒ€**ï¼šJSONå­—ç¬¦ä¸²é€šå¸¸æ¯”äºŒè¿›åˆ¶æ ¼å¼æ›´å¤§

---

## 4. ğŸš€ é«˜çº§åºåˆ—åŒ–æ–¹æ¡ˆ


### 4.1 JSONåºåˆ—åŒ–è¯¦è§£


**ä¸ºä»€ä¹ˆé€‰æ‹©JSONï¼Ÿ**
- **å¯è¯»æ€§å¥½**ï¼šäººç±»å¯ä»¥ç›´æ¥é˜…è¯»
- **è·¨è¯­è¨€**ï¼šå‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒ
- **è°ƒè¯•å‹å¥½**ï¼šå‡ºé—®é¢˜æ—¶å®¹æ˜“æ’æŸ¥
- **ç”Ÿæ€ä¸°å¯Œ**ï¼šå·¥å…·å’Œåº“å¾ˆå¤š

**JSONåºåˆ—åŒ–å®ç°**ï¼š

```java
// ä½¿ç”¨Jacksonå®ç°JSONåºåˆ—åŒ–å™¨
public class JsonSerializer<T> implements Serializer<T> {
    private final ObjectMapper objectMapper = new ObjectMapper();
    
    @Override
    public void configure(Map<String, ?> configs, boolean isKey) {
        // å¯ä»¥åœ¨è¿™é‡Œé…ç½®Jacksonçš„è¡Œä¸º
    }
    
    @Override
    public byte[] serialize(String topic, T data) {
        if (data == null) return null;
        
        try {
            return objectMapper.writeValueAsBytes(data);
        } catch (JsonProcessingException e) {
            throw new SerializationException("JSONåºåˆ—åŒ–å¤±è´¥", e);
        }
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// å®šä¹‰ç”¨æˆ·ç±»
class User {
    private String name;
    private int age;
    // getter/setter...
}

// é…ç½®Producerä½¿ç”¨JSONåºåˆ—åŒ–
Properties props = new Properties();
props.put("value.serializer", "com.example.JsonSerializer");

// å‘é€ç”¨æˆ·å¯¹è±¡
User user = new User("å¼ ä¸‰", 25);
producer.send(new ProducerRecord<>("users", user));

// å®é™…å‘é€çš„æ•°æ®ï¼š{"name":"å¼ ä¸‰","age":25}
```

### 4.2 Avroåºåˆ—åŒ–æ·±å…¥


**Avroçš„ä¼˜åŠ¿**ï¼š
- **æ¨¡å¼å®šä¹‰**ï¼šä¸¥æ ¼çš„æ•°æ®ç»“æ„å®šä¹‰
- **å‘åå…¼å®¹**ï¼šæ”¯æŒæ•°æ®ç»“æ„æ¼”åŒ–
- **ç´§å‡‘æ ¼å¼**ï¼šäºŒè¿›åˆ¶å­˜å‚¨ï¼Œç©ºé—´æ•ˆç‡é«˜
- **ä»£ç ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆæ•°æ®ç±»

**Avroä½¿ç”¨æµç¨‹**ï¼š

```
æ­¥éª¤1ï¼šå®šä¹‰Avroæ¨¡å¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user.avscæ–‡ä»¶     â”‚
â”‚   {                 â”‚
â”‚     "type":"record",â”‚
â”‚     "name":"User",  â”‚
â”‚     "fields":[...]  â”‚
â”‚   }                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
æ­¥éª¤2ï¼šç”ŸæˆJavaç±»
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User.javaç±»       â”‚
â”‚   (è‡ªåŠ¨ç”Ÿæˆ)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
æ­¥éª¤3ï¼šä½¿ç”¨Avroåºåˆ—åŒ–å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AvroSerializer<User>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Avroé…ç½®ç¤ºä¾‹**ï¼š
```java
Properties props = new Properties();
props.put("key.serializer", "io.confluent.kafka.serializers.KafkaAvroSerializer");
props.put("value.serializer", "io.confluent.kafka.serializers.KafkaAvroSerializer");
props.put("schema.registry.url", "http://localhost:8081");
```

### 4.3 Protobufåºåˆ—åŒ–


**Protobufç‰¹ç‚¹**ï¼š
- **Googleå¼€å‘**ï¼šæˆç†Ÿç¨³å®šçš„åºåˆ—åŒ–æ¡†æ¶
- **å¼ºç±»å‹**ï¼šç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- **é«˜æ€§èƒ½**ï¼šåºåˆ—åŒ–é€Ÿåº¦å¿«ï¼Œä½“ç§¯å°
- **è·¨è¯­è¨€**ï¼šæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€

**Protobufå®šä¹‰ç¤ºä¾‹**ï¼š
```protobuf
// user.protoæ–‡ä»¶
syntax = "proto3";

message User {
    string name = 1;
    int32 age = 2;
    repeated string hobbies = 3;
}
```

---

## 5. ğŸ¯ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¼€å‘


### 5.1 å¼€å‘è‡ªå®šä¹‰åºåˆ—åŒ–å™¨çš„æ—¶æœº


**ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰ï¼Ÿ**

âœ… **éœ€è¦è‡ªå®šä¹‰çš„åœºæ™¯**ï¼š
- ç°æœ‰åºåˆ—åŒ–å™¨æ— æ³•æ»¡è¶³éœ€æ±‚
- éœ€è¦ç‰¹æ®Šçš„æ•°æ®æ ¼å¼å¤„ç†
- å¯¹æ€§èƒ½æœ‰æè‡´è¦æ±‚
- éœ€è¦åŠ å¯†æˆ–å‹ç¼©æ•°æ®
- æœ‰ç‰¹æ®Šçš„å…¼å®¹æ€§è¦æ±‚

âŒ **ä¸éœ€è¦è‡ªå®šä¹‰çš„åœºæ™¯**ï¼š
- ç®€å•çš„æ•°æ®ç±»å‹ï¼ˆç”¨å†…ç½®åºåˆ—åŒ–å™¨ï¼‰
- æ ‡å‡†çš„JSONæ ¼å¼ï¼ˆç”¨ç°æˆçš„JSONåº“ï¼‰
- æœ‰æˆç†Ÿæ–¹æ¡ˆçš„æ ¼å¼ï¼ˆå¦‚Avroã€Protobufï¼‰

### 5.2 è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å®æˆ˜


**éœ€æ±‚åœºæ™¯**ï¼šä¸ºç”¨æˆ·å¯¹è±¡å®ç°é«˜æ•ˆçš„äºŒè¿›åˆ¶åºåˆ—åŒ–

```java
// ç”¨æˆ·å®ä½“ç±»
public class User {
    private String name;
    private int age;
    private String email;
    
    // æ„é€ å‡½æ•°ã€getterã€setter...
}

// è‡ªå®šä¹‰ç”¨æˆ·åºåˆ—åŒ–å™¨
public class UserSerializer implements Serializer<User> {
    
    @Override
    public void configure(Map<String, ?> configs, boolean isKey) {
        // è¯»å–é…ç½®ï¼Œä¾‹å¦‚ç¼–ç æ ¼å¼
    }
    
    @Override
    public byte[] serialize(String topic, User user) {
        if (user == null) return null;
        
        try {
            ByteArrayOutputStream baos = new ByteArrayOutputStream();
            DataOutputStream dos = new DataOutputStream(baos);
            
            // æŒ‰å›ºå®šæ ¼å¼å†™å…¥æ•°æ®
            dos.writeUTF(user.getName());      // å†™å…¥å§“å
            dos.writeInt(user.getAge());       // å†™å…¥å¹´é¾„
            dos.writeUTF(user.getEmail());     // å†™å…¥é‚®ç®±
            
            return baos.toByteArray();
        } catch (IOException e) {
            throw new SerializationException("ç”¨æˆ·åºåˆ—åŒ–å¤±è´¥", e);
        }
    }
}

// å¯¹åº”çš„ååºåˆ—åŒ–å™¨
public class UserDeserializer implements Deserializer<User> {
    
    @Override
    public User deserialize(String topic, byte[] data) {
        if (data == null) return null;
        
        try {
            ByteArrayInputStream bais = new ByteArrayInputStream(data);
            DataInputStream dis = new DataInputStream(bais);
            
            // æŒ‰ç›¸åŒé¡ºåºè¯»å–æ•°æ®
            String name = dis.readUTF();
            int age = dis.readInt();
            String email = dis.readUTF();
            
            return new User(name, age, email);
        } catch (IOException e) {
            throw new SerializationException("ç”¨æˆ·ååºåˆ—åŒ–å¤±è´¥", e);
        }
    }
}
```

### 5.3 è‡ªå®šä¹‰åºåˆ—åŒ–å™¨æœ€ä½³å®è·µ


**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–æŠ€å·§**ï¼š

```java
public class OptimizedUserSerializer implements Serializer<User> {
    // é‡ç”¨ç¼“å†²åŒºï¼Œé¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡
    private final ByteArrayOutputStream buffer = new ByteArrayOutputStream();
    private final DataOutputStream output = new DataOutputStream(buffer);
    
    @Override
    public byte[] serialize(String topic, User user) {
        if (user == null) return null;
        
        try {
            buffer.reset(); // é‡ç½®ç¼“å†²åŒº
            
            output.writeUTF(user.getName());
            output.writeInt(user.getAge());
            output.writeUTF(user.getEmail());
            
            return buffer.toByteArray();
        } catch (IOException e) {
            throw new SerializationException("åºåˆ—åŒ–å¤±è´¥", e);
        }
    }
}
```

**ğŸ”¸ é”™è¯¯å¤„ç†ç­–ç•¥**ï¼š

```java
@Override
public byte[] serialize(String topic, User user) {
    // 1. ç©ºå€¼æ£€æŸ¥
    if (user == null) return null;
    
    // 2. æ•°æ®éªŒè¯
    if (user.getName() == null || user.getName().trim().isEmpty()) {
        throw new SerializationException("ç”¨æˆ·å§“åä¸èƒ½ä¸ºç©º");
    }
    
    try {
        // åºåˆ—åŒ–é€»è¾‘...
    } catch (IOException e) {
        // 3. è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
        throw new SerializationException(
            String.format("åºåˆ—åŒ–ç”¨æˆ·å¤±è´¥: name=%s, age=%d", 
                         user.getName(), user.getAge()), e);
    }
}
```

---

## 6. ğŸ“Š Schema Registryé›†æˆå®è·µ


### 6.1 ä»€ä¹ˆæ˜¯Schema Registry


**é€šä¿—ç†è§£**ï¼šSchema Registryå°±åƒæ˜¯æ•°æ®æ ¼å¼çš„"å›¾ä¹¦é¦†ç®¡ç†å‘˜"

```
æ²¡æœ‰Schema Registryçš„é—®é¢˜ï¼š
ç”Ÿäº§è€…A: å‘é€ {"name":"å¼ ä¸‰", "age":25}
ç”Ÿäº§è€…B: å‘é€ {"userName":"æå››", "userAge":30}  â† å­—æ®µåä¸åŒï¼
æ¶ˆè´¹è€…:   ä¸çŸ¥é“è¯¥æœŸå¾…å“ªç§æ ¼å¼ ğŸ˜µ

æœ‰äº†Schema Registryï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Schema Registry â”‚  â† ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ•°æ®æ ¼å¼
â”‚   å­˜å‚¨æ‰€æœ‰æ¨¡å¼   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
æ‰€æœ‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½ä½¿ç”¨ç›¸åŒçš„æ•°æ®æ ¼å¼è§„èŒƒ âœ…
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **æ ¼å¼ç»Ÿä¸€**ï¼šç¡®ä¿æ‰€æœ‰åº”ç”¨ä½¿ç”¨ç›¸åŒçš„æ•°æ®ç»“æ„
- **ç‰ˆæœ¬ç®¡ç†**ï¼šæ”¯æŒæ•°æ®ç»“æ„çš„å¹³æ»‘å‡çº§
- **å…¼å®¹æ€§æ£€æŸ¥**ï¼šé˜²æ­¢ç ´åæ€§çš„æ ¼å¼å˜æ›´

### 6.2 Schema Registryå·¥ä½œåŸç†


```
æ¶ˆæ¯å‘é€æµç¨‹ï¼š
ç”Ÿäº§è€… â†’ æŸ¥è¯¢Schema â†’ Schema Registry
   â†“                        â†“
åºåˆ—åŒ–æ¶ˆæ¯              è¿”å›Schema ID
   â†“                        â†“
å‘é€åˆ°Kafka â† æ¶ˆæ¯åŒ…å«Schema ID

æ¶ˆæ¯æ¶ˆè´¹æµç¨‹ï¼š
æ¶ˆè´¹è€… â† æ¥æ”¶æ¶ˆæ¯ â† Kafka
   â†“
æå–Schema ID
   â†“
æŸ¥è¯¢Schema â†’ Schema Registry
   â†“                â†“
ååºåˆ—åŒ– â† è¿”å›Schemaå®šä¹‰
```

### 6.3 Schema Registryé…ç½®å®è·µ


**ç¯å¢ƒæ­å»º**ï¼š
```bash
# 1. å¯åŠ¨Schema RegistryæœåŠ¡
docker run -d \
  --name schema-registry \
  -p 8081:8081 \
  -e SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS=localhost:9092 \
  confluentinc/cp-schema-registry

# 2. éªŒè¯æœåŠ¡å¯åŠ¨
curl http://localhost:8081/subjects
```

**Produceré…ç½®**ï¼š
```java
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");

// ä½¿ç”¨Avroåºåˆ—åŒ–å™¨
props.put("key.serializer", "io.confluent.kafka.serializers.KafkaAvroSerializer");
props.put("value.serializer", "io.confluent.kafka.serializers.KafkaAvroSerializer");

// é…ç½®Schema Registryåœ°å€
props.put("schema.registry.url", "http://localhost:8081");

KafkaProducer<String, User> producer = new KafkaProducer<>(props);
```

**Consumeré…ç½®**ï¼š
```java
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("group.id", "user-consumer-group");

// ä½¿ç”¨Avroååºåˆ—åŒ–å™¨
props.put("key.deserializer", "io.confluent.kafka.serializers.KafkaAvroDeserializer");
props.put("value.deserializer", "io.confluent.kafka.serializers.KafkaAvroDeserializer");

// é…ç½®Schema Registryåœ°å€
props.put("schema.registry.url", "http://localhost:8081");

KafkaConsumer<String, User> consumer = new KafkaConsumer<>(props);
```

### 6.4 Schemaæ¼”åŒ–å®è·µ


**å‘åå…¼å®¹çš„Schemaå‡çº§**ï¼š

```json
// åŸå§‹Schema v1
{
  "type": "record",
  "name": "User",
  "fields": [
    {"name": "name", "type": "string"},
    {"name": "age", "type": "int"}
  ]
}

// å‡çº§åSchema v2 (å‘åå…¼å®¹)
{
  "type": "record", 
  "name": "User",
  "fields": [
    {"name": "name", "type": "string"},
    {"name": "age", "type": "int"},
    {"name": "email", "type": ["null", "string"], "default": null}  // æ–°å¢å­—æ®µæœ‰é»˜è®¤å€¼
  ]
}
```

**å…¼å®¹æ€§ç­–ç•¥**ï¼š

| ç­–ç•¥ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `BACKWARD` | `æ–°Schemaèƒ½è¯»å–æ—§æ•°æ®` | æ¶ˆè´¹è€…å…ˆå‡çº§ |
| `FORWARD` | `æ—§Schemaèƒ½è¯»å–æ–°æ•°æ®` | ç”Ÿäº§è€…å…ˆå‡çº§ |
| `FULL` | `å®Œå…¨å…¼å®¹ï¼ŒåŒå‘å…¼å®¹` | æœ€å®‰å…¨çš„é€‰æ‹© |

---

## 7. âš¡ åºåˆ—åŒ–æ€§èƒ½ä¼˜åŒ–ä¸å¯¹æ¯”


### 7.1 å„ç§åºåˆ—åŒ–æ–¹æ¡ˆæ€§èƒ½å¯¹æ¯”


**æ€§èƒ½æµ‹è¯•ç»“æœ**ï¼ˆåŸºäº100ä¸‡æ¡ç”¨æˆ·è®°å½•ï¼‰ï¼š

| åºåˆ—åŒ–æ–¹æ¡ˆ | åºåˆ—åŒ–æ—¶é—´ | ååºåˆ—åŒ–æ—¶é—´ | æ•°æ®å¤§å° | å¯è¯»æ€§ | å…¼å®¹æ€§ |
|-----------|----------|------------|---------|--------|---------|
| **JavaåŸç”Ÿ** | `850ms` | `920ms` | `å¤§` | âŒ | Javaä¸“ç”¨ |
| **JSON** | `1200ms` | `1100ms` | `å¤§` | âœ… | è·¨è¯­è¨€ |
| **Avro** | `400ms` | `380ms` | `å°` | âŒ | è·¨è¯­è¨€ |
| **Protobuf** | `320ms` | `300ms` | `å¾ˆå°` | âŒ | è·¨è¯­è¨€ |
| **è‡ªå®šä¹‰äºŒè¿›åˆ¶** | `150ms` | `140ms` | `å¾ˆå°` | âŒ | å®šåˆ¶åŒ– |

### 7.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ é€‰æ‹©åˆé€‚çš„åºåˆ—åŒ–æ–¹æ¡ˆ**ï¼š

```java
// æ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©åºåˆ—åŒ–å™¨
public class SerializerSelector {
    
    public static Serializer<?> choose(String scenario) {
        switch (scenario) {
            case "debug":
                return new JsonSerializer<>();    // è°ƒè¯•é˜¶æ®µç”¨JSON
            case "production":
                return new AvroSerializer<>();    // ç”Ÿäº§ç¯å¢ƒç”¨Avro
            case "high_performance":
                return new ProtobufSerializer<>(); // æ€§èƒ½è¦æ±‚æé«˜ç”¨Protobuf
            default:
                return new StringSerializer();     // é»˜è®¤ç”¨String
        }
    }
}
```

**ğŸ”¸ åºåˆ—åŒ–å™¨ä¼˜åŒ–æŠ€å·§**ï¼š

```java
public class HighPerformanceSerializer implements Serializer<User> {
    // 1. å¯¹è±¡æ± ï¼Œå‡å°‘GCå‹åŠ›
    private final ThreadLocal<ByteArrayOutputStream> bufferPool = 
        ThreadLocal.withInitial(() -> new ByteArrayOutputStream(1024));
    
    // 2. é¢„åˆ†é…ç¼“å†²åŒº
    private static final int INITIAL_CAPACITY = 256;
    
    @Override
    public byte[] serialize(String topic, User user) {
        ByteArrayOutputStream buffer = bufferPool.get();
        buffer.reset(); // é‡ç”¨ç¼“å†²åŒº
        
        // 3. ä½¿ç”¨é«˜æ•ˆçš„ç¼–ç æ–¹å¼
        writeVarInt(buffer, user.getName().length());
        writeString(buffer, user.getName());
        writeVarInt(buffer, user.getAge());
        
        return buffer.toByteArray();
    }
    
    // å˜é•¿æ•´æ•°ç¼–ç ï¼ŒèŠ‚çœç©ºé—´
    private void writeVarInt(ByteArrayOutputStream out, int value) {
        while ((value & 0x80) != 0) {
            out.write((value & 0x7F) | 0x80);
            value >>>= 7;
        }
        out.write(value & 0x7F);
    }
}
```

### 7.3 åºåˆ—åŒ–æ–¹æ¡ˆé€‰æ‹©æŒ‡å—


**å†³ç­–æ ‘**ï¼š

```
æ•°æ®é‡å¾ˆå¤§ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ€§èƒ½è¦æ±‚æé«˜ï¼Ÿ
â”‚     â”œâ”€ æ˜¯ â†’ Protobuf æˆ– è‡ªå®šä¹‰äºŒè¿›åˆ¶
â”‚     â””â”€ å¦ â†’ Avro
â””â”€ å¦ â†’ éœ€è¦è·¨è¯­è¨€ï¼Ÿ
      â”œâ”€ æ˜¯ â†’ JSON
      â””â”€ å¦ â†’ JavaåŸç”Ÿåºåˆ—åŒ–
```

**å®é™…åº”ç”¨å»ºè®®**ï¼š

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| **å¼€å‘è°ƒè¯•** | `JSON` | å¯è¯»æ€§å¥½ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ |
| **ç”Ÿäº§ç¯å¢ƒ** | `Avro + Schema Registry` | æ€§èƒ½å¥½ï¼Œæœ‰ç‰ˆæœ¬ç®¡ç† |
| **æè‡´æ€§èƒ½** | `Protobuf` | é€Ÿåº¦å¿«ï¼Œä½“ç§¯å° |
| **ç®€å•åº”ç”¨** | `å†…ç½®åºåˆ—åŒ–å™¨` | é…ç½®ç®€å•ï¼Œå¤Ÿç”¨ |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åºåˆ—åŒ–æœ¬è´¨ï¼šå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œç”¨äºç½‘ç»œä¼ è¾“å’Œå­˜å‚¨
ğŸ”¸ æ¥å£å®ç°ï¼šæ‰€æœ‰åºåˆ—åŒ–å™¨éƒ½å®ç°Serializer<T>æ¥å£
ğŸ”¸ é…å¯¹ä½¿ç”¨ï¼šåºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨å¿…é¡»é…å¯¹ä½¿ç”¨
ğŸ”¸ æ€§èƒ½æƒè¡¡ï¼šé€Ÿåº¦ã€ä½“ç§¯ã€å…¼å®¹æ€§ä¹‹é—´éœ€è¦å¹³è¡¡
ğŸ”¸ Schemaç®¡ç†ï¼šå¤æ‚åº”ç”¨éœ€è¦ç»Ÿä¸€çš„æ•°æ®æ ¼å¼ç®¡ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–**
```
Kafkaä¼ è¾“åŸç†ï¼š
- Kafkaåªèƒ½ä¼ è¾“å­—èŠ‚æ•°æ®ï¼ˆbyte[]ï¼‰
- Javaå¯¹è±¡æ— æ³•ç›´æ¥é€šè¿‡ç½‘ç»œä¼ è¾“
- åºåˆ—åŒ–æ˜¯å¯¹è±¡ä¸å­—èŠ‚æ•°ç»„ä¹‹é—´çš„æ¡¥æ¢
```

**ğŸ”¹ å¦‚ä½•é€‰æ‹©åºåˆ—åŒ–æ–¹æ¡ˆ**
```
é€‰æ‹©æ ‡å‡†ï¼š
1. æ€§èƒ½è¦æ±‚ï¼šé«˜æ€§èƒ½é€‰äºŒè¿›åˆ¶æ ¼å¼
2. è°ƒè¯•éœ€æ±‚ï¼šè°ƒè¯•é˜¶æ®µé€‰å¯è¯»æ ¼å¼
3. å…¼å®¹æ€§ï¼šè·¨è¯­è¨€åº”ç”¨é€‰é€šç”¨æ ¼å¼
4. å¤æ‚åº¦ï¼šç®€å•åº”ç”¨é€‰å†…ç½®æ–¹æ¡ˆ
```

**ğŸ”¹ Schema Registryçš„ä»·å€¼**
```
è§£å†³é—®é¢˜ï¼š
- æ•°æ®æ ¼å¼æ··ä¹±ï¼šç»Ÿä¸€Schemaå®šä¹‰
- ç‰ˆæœ¬å…¼å®¹æ€§ï¼šå¹³æ»‘çš„æ•°æ®ç»“æ„å‡çº§
- é”™è¯¯é¢„é˜²ï¼šç¼–è¯‘æ—¶å‘ç°æ ¼å¼é—®é¢˜
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ–°æ‰‹å…¥é—¨è·¯çº¿**ï¼š
1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šæŒæ¡å†…ç½®åºåˆ—åŒ–å™¨ï¼ˆStringã€Integerç­‰ï¼‰
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šå­¦ä¼šä½¿ç”¨JSONåºåˆ—åŒ–å¤„ç†å¤æ‚å¯¹è±¡
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šäº†è§£Avro/Protobufé«˜æ€§èƒ½æ–¹æ¡ˆ
4. **ç¬¬å››é˜¶æ®µ**ï¼šæŒæ¡Schema Registryè¿›è¡Œæ•°æ®æ²»ç†

**ğŸ› ï¸ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**ï¼š
- **ç»Ÿä¸€æ ‡å‡†**ï¼šå›¢é˜Ÿå†…ç»Ÿä¸€åºåˆ—åŒ–æ–¹æ¡ˆ
- **æ€§èƒ½æµ‹è¯•**ï¼šé’ˆå¯¹å®é™…æ•°æ®è¿›è¡Œæ€§èƒ½æµ‹è¯•
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„åºåˆ—åŒ–å¼‚å¸¸å¤„ç†æœºåˆ¶
- **ç›‘æ§å‘Šè­¦**ï¼šåºåˆ—åŒ–å¤±è´¥ç‡å’Œæ€§èƒ½ç›‘æ§
- **ç‰ˆæœ¬ç®¡ç†**ï¼šå»ºç«‹Schemaç‰ˆæœ¬ç®¡ç†æµç¨‹

**âš ï¸ å¸¸è§é™·é˜±é¿å…**ï¼š
- **åºåˆ—åŒ–å™¨ä¸åŒ¹é…**ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä½¿ç”¨ä¸åŒåºåˆ—åŒ–å™¨
- **ç©ºå€¼å¤„ç†**ï¼šå¿˜è®°å¤„ç†nullå€¼çš„åºåˆ—åŒ–
- **æ€§èƒ½é—®é¢˜**ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨ä½æ•ˆåºåˆ—åŒ–å™¨
- **å…¼å®¹æ€§é—®é¢˜**ï¼šSchemaå˜æ›´æ—¶ç ´åå‘åå…¼å®¹æ€§
- **èµ„æºæ³„æ¼**ï¼šè‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¿˜è®°å…³é—­èµ„æº

**æ ¸å¿ƒè®°å¿†**ï¼š
- åºåˆ—åŒ–æ˜¯å¯¹è±¡å˜å­—èŠ‚çš„é­”æ³•è½¬æ¢å™¨
- å†…ç½®å¤Ÿç”¨é€‰å†…ç½®ï¼Œå¤æ‚åœºæ™¯é€‰ä¸“ä¸šæ–¹æ¡ˆ
- æ€§èƒ½ä¸å…¼å®¹æ€§éœ€è¦æ ¹æ®åœºæ™¯å¹³è¡¡å–èˆ
- Schema Registryè®©æ•°æ®æ ¼å¼äº•ç„¶æœ‰åº