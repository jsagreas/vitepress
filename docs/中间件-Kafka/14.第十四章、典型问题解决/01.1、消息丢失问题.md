---
title: 1ã€æ¶ˆæ¯ä¸¢å¤±é—®é¢˜
---
## ğŸ“š ç›®å½•

1. [æ¶ˆæ¯å¯é æ€§åŸºç¡€æ¦‚å¿µ](#1-æ¶ˆæ¯å¯é æ€§åŸºç¡€æ¦‚å¿µ)
2. [ç”Ÿäº§è€…ç«¯å¯é æ€§é…ç½®](#2-ç”Ÿäº§è€…ç«¯å¯é æ€§é…ç½®)
3. [Brokeré›†ç¾¤å¯é æ€§ä¿éšœ](#3-Brokeré›†ç¾¤å¯é æ€§ä¿éšœ)
4. [æ¶ˆè´¹è€…ç«¯å¯é æ€§æœºåˆ¶](#4-æ¶ˆè´¹è€…ç«¯å¯é æ€§æœºåˆ¶)
5. [å¸¸è§é—®é¢˜æ’æŸ¥ä¸è§£å†³](#5-å¸¸è§é—®é¢˜æ’æŸ¥ä¸è§£å†³)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¬ æ¶ˆæ¯å¯é æ€§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯å¯é æ€§


**ğŸ”¸ é€šä¿—ç†è§£**
> æƒ³è±¡ä½ é€šè¿‡å¿«é€’å¯„é€é‡è¦æ–‡ä»¶ï¼Œä½ å¸Œæœ›æ–‡ä»¶èƒ½å®‰å…¨é€è¾¾ï¼Œä¸ä¸¢å¤±ã€ä¸æŸåã€‚Kafkaçš„æ¶ˆæ¯å¯é æ€§å°±æ˜¯ä¿è¯ä½ å‘é€çš„æ•°æ®èƒ½å¤Ÿå®‰å…¨åˆ°è¾¾ç›®çš„åœ°ï¼Œä¸ä¼šåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚

**ğŸ¯ å¯é æ€§çš„ä¸‰ä¸ªå±‚é¢**

```
æ¶ˆæ¯ä¼ é€’çš„å®Œæ•´é“¾è·¯ï¼š

ç”Ÿäº§è€…åº”ç”¨ â”€â”€â”€â”€[å‘é€]â”€â”€â”€â†’ Kafkaé›†ç¾¤ â”€â”€â”€â”€[å­˜å‚¨]â”€â”€â”€â†’ æ¶ˆè´¹è€…åº”ç”¨
     â†“                      â†“                    â†“
   å‘é€ä¿éšœ               å­˜å‚¨ä¿éšœ             æ¶ˆè´¹ä¿éšœ
 (ç¡®è®¤æœºåˆ¶)             (å‰¯æœ¬æœºåˆ¶)           (åç§»é‡ç®¡ç†)
```

| **é˜¶æ®µ** | **å¯èƒ½çš„é£é™©** | **ä¿éšœæœºåˆ¶** | **é…ç½®å…³é”®è¯** |
|---------|---------------|-------------|---------------|
| **ç”Ÿäº§é˜¶æ®µ** | `ç½‘ç»œæ•…éšœã€Brokerå®•æœº` | `acksç¡®è®¤ã€é‡è¯•æœºåˆ¶` | `acks=all, retries` |
| **å­˜å‚¨é˜¶æ®µ** | `ç£ç›˜æ•…éšœã€å‰¯æœ¬ä¸¢å¤±` | `å¤šå‰¯æœ¬ã€åŒæ­¥æœºåˆ¶` | `replication.factor, min.insync.replicas` |
| **æ¶ˆè´¹é˜¶æ®µ** | `æ¶ˆè´¹è€…å®•æœºã€é‡å¤æ¶ˆè´¹` | `åç§»é‡æäº¤ã€æ‰‹åŠ¨ç¡®è®¤` | `enable.auto.commit=false` |

### 1.2 æ¶ˆæ¯ä¸¢å¤±çš„å¸¸è§åœºæ™¯


**âš ï¸ ç°å®ä¸­çš„ä¸¢å¤±åœºæ™¯**

```
åœºæ™¯ä¸€ï¼šå¿«é€’å‘˜æŠ•é€’å¤±è´¥
ç”Ÿäº§è€… â†’ [ç½‘ç»œè¶…æ—¶] â†’ Broker
é—®é¢˜ï¼šæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œä½†ç”Ÿäº§è€…ä¸çŸ¥é“

åœºæ™¯äºŒï¼šä»“åº“ç€ç«
Brokerå­˜å‚¨ â†’ [ç£ç›˜æ•…éšœ] â†’ æ•°æ®ä¸¢å¤±
é—®é¢˜ï¼šåªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œç¡¬ä»¶æ•…éšœå¯¼è‡´æ•°æ®æ°¸ä¹…ä¸¢å¤±

åœºæ™¯ä¸‰ï¼šæ”¶ä»¶äººä¸åœ¨å®¶
Broker â†’ [æ¶ˆè´¹è€…å®•æœº] â†’ æ¶ˆæ¯å †ç§¯
é—®é¢˜ï¼šæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯åå®•æœºï¼Œoffsetæœªæäº¤
```

---

## 2. ğŸš€ ç”Ÿäº§è€…ç«¯å¯é æ€§é…ç½®


### 2.1 ackså‚æ•°è¯¦è§£


**ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µï¼šacksç¡®è®¤æœºåˆ¶**

> **é€šä¿—è§£é‡Š**ï¼šackså°±åƒä½ å‘å¿«é€’æ—¶é€‰æ‹©çš„æœåŠ¡ç­‰çº§ã€‚æ™®é€šå¿«é€’ï¼ˆacks=0ï¼‰æŠ•é€’äº†å°±èµ°ï¼Œä¸ç®¡ä½ æ”¶æ²¡æ”¶åˆ°ï¼›ç­¾æ”¶å¿«é€’ï¼ˆacks=1ï¼‰è¦ç¡®è®¤ä½ æœ¬äººæ”¶åˆ°ï¼›ä¿ä»·å¿«é€’ï¼ˆacks=allï¼‰ä¸ä»…ä½ è¦æ”¶åˆ°ï¼Œè¿˜è¦é‚»å±…ä½œè¯ã€‚

```
acksé…ç½®å¯¹æ¯”å›¾ï¼š

acks=0 (æ— ç¡®è®¤)
ç”Ÿäº§è€… â”€â”€[å‘é€]â”€â”€â†’ Broker âœ“å‘é€æˆåŠŸ
       ä¸ç­‰å¾…ä»»ä½•ç¡®è®¤

acks=1 (Leaderç¡®è®¤)  
ç”Ÿäº§è€… â”€â”€[å‘é€]â”€â”€â†’ Leader â”€â”€[ç¡®è®¤]â”€â”€â†’ ç”Ÿäº§è€…
                   â†“
               å†™å…¥æˆåŠŸ

acks=all (å…¨éƒ¨ç¡®è®¤)
ç”Ÿäº§è€… â”€â”€[å‘é€]â”€â”€â†’ Leader â”€â”€[åŒæ­¥]â”€â”€â†’ Follower1
                   â†“         [åŒæ­¥]â”€â”€â†’ Follower2  
               ç­‰å¾…ISRå…¨éƒ¨ç¡®è®¤ â”€â”€[ç¡®è®¤]â”€â”€â†’ ç”Ÿäº§è€…
```

**ğŸ“Š acksé…ç½®å¯¹æ¯”è¡¨**

| **é…ç½®å€¼** | **ç¡®è®¤è¦æ±‚** | **æ€§èƒ½** | **å¯é æ€§** | **é€‚ç”¨åœºæ™¯** |
|-----------|-------------|---------|-----------|-------------|
| `acks=0` | `ä¸ç­‰å¾…ä»»ä½•ç¡®è®¤` | `ğŸŸ¢æœ€é«˜` | `ğŸ”´æœ€ä½` | `æ—¥å¿—æ”¶é›†ã€æŒ‡æ ‡ç»Ÿè®¡` |
| `acks=1` | `Leaderå‰¯æœ¬ç¡®è®¤` | `ğŸŸ¡ä¸­ç­‰` | `ğŸŸ¡ä¸­ç­‰` | `ä¸€èˆ¬ä¸šåŠ¡æ¶ˆæ¯` |
| `acks=all/-1` | `ISRåˆ—è¡¨å…¨éƒ¨ç¡®è®¤` | `ğŸ”´æœ€ä½` | `ğŸŸ¢æœ€é«˜` | `é‡‘èäº¤æ˜“ã€æ ¸å¿ƒä¸šåŠ¡` |

### 2.2 é‡è¯•æœºåˆ¶é…ç½®


**ğŸ”„ ç”Ÿäº§è€…é‡è¯•ç­–ç•¥**

```java
// ç”Ÿäº§è€…å¯é æ€§é…ç½®ç¤ºä¾‹
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("acks", "all");                    // ç­‰å¾…æ‰€æœ‰å‰¯æœ¬ç¡®è®¤
props.put("retries", 2147483647);           // æœ€å¤§é‡è¯•æ¬¡æ•°
props.put("retry.backoff.ms", 100);         // é‡è¯•é—´éš”
props.put("delivery.timeout.ms", 120000);   // æ€»è¶…æ—¶æ—¶é—´
props.put("max.in.flight.requests.per.connection", 5); // å¹¶å‘è¯·æ±‚æ•°
```

**âš¡ é‡è¯•æœºåˆ¶å·¥ä½œæµç¨‹**

```
æ¶ˆæ¯å‘é€é‡è¯•æµç¨‹ï¼š

ç¬¬1æ¬¡å‘é€ â”€â”€[å¤±è´¥]â”€â”€â†’ ç­‰å¾…100ms â”€â”€â†’ ç¬¬2æ¬¡å‘é€ â”€â”€[å¤±è´¥]â”€â”€â†’ ç­‰å¾…200ms
    â†“                                    â†“
ç½‘ç»œè¶…æ—¶                              Brokerç¹å¿™
    â†“                                    â†“
ç»§ç»­é‡è¯•...                           ç»§ç»­é‡è¯•...
    â†“                                    â†“
[2åˆ†é’Ÿå] â”€â”€â†’ è¶…è¿‡delivery.timeout.ms â”€â”€â†’ æœ€ç»ˆå¤±è´¥
```

> **ğŸ’¡ å…³é”®ç†è§£**ï¼šé‡è¯•ä¸æ˜¯æ— é™åˆ¶çš„ï¼Œæœ‰æ€»æ—¶é—´é™åˆ¶ã€‚å°±åƒä½ ç»™æœ‹å‹æ‰“ç”µè¯ï¼Œå¦‚æœä¸€ç›´å çº¿ï¼Œä½ ä¼šé‡æ‹¨å‡ æ¬¡ï¼Œä½†ä¸ä¼šæ‰“ä¸€æ•´å¤©ã€‚

### 2.3 å¹‚ç­‰æ€§é…ç½®


**ğŸ›¡ï¸ é˜²æ­¢é‡å¤æ¶ˆæ¯**

```java
// å¼€å¯å¹‚ç­‰æ€§é…ç½®
props.put("enable.idempotence", true);  // å¯ç”¨å¹‚ç­‰æ€§
```

**ğŸ” å¹‚ç­‰æ€§åŸç†**

```
å¹‚ç­‰æ€§ä¿éšœæœºåˆ¶ï¼š

ç”Ÿäº§è€…ID + åºåˆ—å· = å”¯ä¸€æ ‡è¯†
    â†“
PID=12345, SeqNum=1 â†’ Message1
PID=12345, SeqNum=2 â†’ Message2  
PID=12345, SeqNum=1 â†’ Message1 (é‡å¤ï¼Œè¢«ä¸¢å¼ƒ)
```

---

## 3. ğŸ¢ Brokeré›†ç¾¤å¯é æ€§ä¿éšœ


### 3.1 å‰¯æœ¬æœºåˆ¶è¯¦è§£


**ğŸ”„ å‰¯æœ¬ç³»ç»Ÿå·¥ä½œåŸç†**

> **ç”Ÿæ´»åŒ–æ¯”å–»**ï¼šå‰¯æœ¬å°±åƒé‡è¦æ–‡ä»¶çš„å¤‡ä»½ã€‚ä½ çš„æ¯•ä¸šè¯ä¹¦å¾ˆé‡è¦ï¼Œæ‰€ä»¥ä½ ä¼šå¤å°å‡ ä»½æ”¾åœ¨ä¸åŒåœ°æ–¹ã€‚å¦‚æœå®¶é‡Œçš„ä¸¢äº†ï¼Œå•ä½è¿˜æœ‰å¤‡ä»½ã€‚

```
Kafkaå‰¯æœ¬åˆ†å¸ƒç¤ºä¾‹ï¼š

Topic: user-events, Partition: 0, Replication Factor: 3

Broker1 (Leader)     Broker2 (Follower)   Broker3 (Follower)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user-events â”‚â”€â”€â”€â”€â†’â”‚ user-events â”‚â”€â”€â”€â”€â”€â†’â”‚ user-events â”‚
â”‚ Part-0      â”‚     â”‚ Part-0      â”‚      â”‚ Part-0      â”‚
â”‚ (å†™å…¥)      â”‚     â”‚ (åŒæ­¥)      â”‚      â”‚ (åŒæ­¥)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“‹ å‰¯æœ¬é…ç½®å…³é”®å‚æ•°**

| **å‚æ•°** | **ä½œç”¨** | **æ¨èå€¼** | **è¯´æ˜** |
|---------|---------|-----------|---------|
| `replication.factor` | `å‰¯æœ¬æ€»æ•°` | `3` | `åŒ…æ‹¬Leaderåœ¨å†…çš„å‰¯æœ¬æ•°é‡` |
| `min.insync.replicas` | `æœ€å°åŒæ­¥å‰¯æœ¬æ•°` | `2` | `acks=allæ—¶ï¼Œè‡³å°‘è¦åŒæ­¥çš„å‰¯æœ¬æ•°` |
| `unclean.leader.election.enable` | `æ˜¯å¦å…è®¸è„é€‰ä¸¾` | `false` | `ç¦æ­¢éISRå‰¯æœ¬æˆä¸ºLeader` |

### 3.2 ISRåˆ—è¡¨æœºåˆ¶


**ğŸ¯ ISR(In-Sync Replicas)æ¦‚å¿µ**

> **é€šä¿—ç†è§£**ï¼šISRå°±åƒä¸€ä¸ª"åˆæ ¼å‘˜å·¥åå•"ã€‚åªæœ‰è·Ÿå¾—ä¸ŠLeaderè¿›åº¦çš„Followeræ‰èƒ½åŠ å…¥è¿™ä¸ªåå•ã€‚å¦‚æœæŸä¸ªFollowerå¤ªæ…¢äº†ï¼Œå°±ä¼šè¢«è¸¢å‡ºåå•ã€‚

```
ISRçŠ¶æ€å˜åŒ–ç¤ºä¾‹ï¼š

åˆå§‹çŠ¶æ€ï¼šISR = [Broker1, Broker2, Broker3]
    â†“
Broker3ç½‘ç»œå»¶è¿Ÿï¼Œè·Ÿä¸ä¸ŠåŒæ­¥
    â†“
ISR = [Broker1, Broker2]  (Broker3è¢«ç§»é™¤)
    â†“
Broker3ç½‘ç»œæ¢å¤ï¼Œè¿½ä¸Šè¿›åº¦
    â†“
ISR = [Broker1, Broker2, Broker3]  (Broker3é‡æ–°åŠ å…¥)
```

**âš ï¸ ISRé…ç½®è¦ç‚¹**

```bash
# å…³é”®é…ç½®
replica.lag.time.max.ms=30000    # å‰¯æœ¬æœ€å¤§å»¶è¿Ÿæ—¶é—´
replica.fetch.wait.max.ms=500    # å‰¯æœ¬æ‹‰å–ç­‰å¾…æ—¶é—´
```

### 3.3 æ•°æ®æŒä¹…åŒ–é…ç½®


**ğŸ’¾ åˆ·ç›˜ç­–ç•¥é…ç½®**

```bash
# BrokeræŒä¹…åŒ–é…ç½®
log.flush.interval.messages=10000    # æ¯10000æ¡æ¶ˆæ¯åˆ·ç›˜
log.flush.interval.ms=1000          # æ¯1ç§’åˆ·ç›˜
log.segment.bytes=1073741824        # æ—¥å¿—æ®µå¤§å°1GB
log.retention.hours=168             # ä¿ç•™7å¤©
```

**ğŸ”„ åˆ·ç›˜æœºåˆ¶è¯´æ˜**

```
æ¶ˆæ¯æŒä¹…åŒ–æµç¨‹ï¼š

å†…å­˜ä¸­çš„æ¶ˆæ¯ â”€â”€[å®šæ—¶/å®šé‡]â”€â”€â†’ ç£ç›˜æ–‡ä»¶
      â†“                      â†“
    OSé¡µç¼“å­˜               .logæ–‡ä»¶
      â†“                      â†“
   ç«‹å³å¯è¯»              æŒä¹…åŒ–å­˜å‚¨
```

---

## 4. ğŸ¯ æ¶ˆè´¹è€…ç«¯å¯é æ€§æœºåˆ¶


### 4.1 åç§»é‡æäº¤ç­–ç•¥


**ğŸ“ Offsetæäº¤æœºåˆ¶è¯¦è§£**

> **ç”Ÿæ´»åŒ–ç†è§£**ï¼šOffsetå°±åƒä¹¦ç­¾ï¼Œè®°å½•ä½ è¯»åˆ°å“ªä¸€é¡µäº†ã€‚è‡ªåŠ¨æäº¤å°±åƒå®šæ—¶è‡ªåŠ¨ä¿å­˜ä¹¦ç­¾ï¼Œæ‰‹åŠ¨æäº¤å°±åƒä½ ä¸»åŠ¨å¤¹ä¹¦ç­¾ã€‚

```
ä¸¤ç§æäº¤æ–¹å¼å¯¹æ¯”ï¼š

è‡ªåŠ¨æäº¤ (enable.auto.commit=true)
è¯»å–æ¶ˆæ¯ â†’ å¤„ç†æ¶ˆæ¯ â†’ [5ç§’åè‡ªåŠ¨æäº¤offset]
          â†“
      å¦‚æœè¿™æ—¶å®•æœº â†’ æ¶ˆæ¯ä¸¢å¤±ï¼

æ‰‹åŠ¨æäº¤ (enable.auto.commit=false)  
è¯»å–æ¶ˆæ¯ â†’ å¤„ç†æ¶ˆæ¯ â†’ æ‰‹åŠ¨æäº¤offset â†’ ç»§ç»­ä¸‹ä¸€æ¡
                    â†“
               å¤„ç†æˆåŠŸæ‰æäº¤ â†’ å¯é ï¼
```

**âœ… æ¨èé…ç½®æ–¹å¼**

```java
// æ¶ˆè´¹è€…å¯é æ€§é…ç½®
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("group.id", "my-group");
props.put("enable.auto.commit", "false");        // ç¦ç”¨è‡ªåŠ¨æäº¤
props.put("auto.offset.reset", "earliest");      // ä»æœ€æ—©å¼€å§‹æ¶ˆè´¹
props.put("max.poll.records", 100);              // æ¯æ¬¡æœ€å¤šæ‹‰å–100æ¡
```

```java
// æ‰‹åŠ¨æäº¤ç¤ºä¾‹
while (true) {
    ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));
    for (ConsumerRecord<String, String> record : records) {
        try {
            // å¤„ç†ä¸šåŠ¡é€»è¾‘
            processMessage(record.value());
            
            // å¤„ç†æˆåŠŸåæ‰æäº¤
            consumer.commitSync();
        } catch (Exception e) {
            // å¤„ç†å¤±è´¥ï¼Œä¸æäº¤offsetï¼Œä¸‹æ¬¡é‡æ–°æ¶ˆè´¹
            log.error("å¤„ç†æ¶ˆæ¯å¤±è´¥", e);
        }
    }
}
```

### 4.2 æ¶ˆè´¹è€…ç»„ç®¡ç†


**ğŸ‘¥ æ¶ˆè´¹è€…ç»„åè°ƒæœºåˆ¶**

```
æ¶ˆè´¹è€…ç»„çŠ¶æ€å˜åŒ–ï¼š

Consumer1å¯åŠ¨ â†’ åŠ å…¥Group â†’ åˆ†é…Partition[0,1]
Consumer2å¯åŠ¨ â†’ åŠ å…¥Group â†’ é‡å¹³è¡¡ â†’ åˆ†é…Partition[0] ç»™C1, [1,2] ç»™C2
Consumer1å®•æœº â†’ è§¦å‘é‡å¹³è¡¡ â†’ Consumer2æ¥ç®¡æ‰€æœ‰Partition
```

**âš–ï¸ é‡å¹³è¡¡é…ç½®ä¼˜åŒ–**

```java
props.put("session.timeout.ms", 30000);         // ä¼šè¯è¶…æ—¶æ—¶é—´
props.put("heartbeat.interval.ms", 3000);       // å¿ƒè·³é—´éš”
props.put("max.poll.interval.ms", 300000);      // æœ€å¤§å¤„ç†æ—¶é—´
```

---

## 5. ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥ä¸è§£å†³


### 5.1 æ¶ˆæ¯ä¸¢å¤±é—®é¢˜è¯Šæ–­


**ğŸš¨ é—®é¢˜æ’æŸ¥æ¸…å•**

```
æ¶ˆæ¯ä¸¢å¤±æ’æŸ¥æ­¥éª¤ï¼š

æ­¥éª¤1ï¼šæ£€æŸ¥ç”Ÿäº§è€…é…ç½®
â”œâ”€â”€ acksæ˜¯å¦è®¾ç½®ä¸ºallï¼Ÿ
â”œâ”€â”€ retriesæ˜¯å¦è¶³å¤Ÿå¤§ï¼Ÿ
â””â”€â”€ æ˜¯å¦å¼€å¯äº†å¹‚ç­‰æ€§ï¼Ÿ

æ­¥éª¤2ï¼šæ£€æŸ¥é›†ç¾¤é…ç½®  
â”œâ”€â”€ replication.factor >= 3ï¼Ÿ
â”œâ”€â”€ min.insync.replicas >= 2ï¼Ÿ
â””â”€â”€ unclean.leader.electionæ˜¯å¦ç¦ç”¨ï¼Ÿ

æ­¥éª¤3ï¼šæ£€æŸ¥æ¶ˆè´¹è€…é…ç½®
â”œâ”€â”€ auto.commitæ˜¯å¦ç¦ç”¨ï¼Ÿ
â”œâ”€â”€ æ˜¯å¦æ‰‹åŠ¨æäº¤offsetï¼Ÿ
â””â”€â”€ å¼‚å¸¸å¤„ç†æ˜¯å¦æ­£ç¡®ï¼Ÿ
```

**ğŸ› ï¸ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ**

| **é—®é¢˜ç°è±¡** | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|-------------|-------------|-------------|
| `ç”Ÿäº§è€…å‘é€å¤±è´¥` | `acks=0, ç½‘ç»œé—®é¢˜` | `è®¾ç½®acks=all, å¢åŠ é‡è¯•` |
| `Brokeræ•°æ®ä¸¢å¤±` | `å‰¯æœ¬æ•°ä¸è¶³` | `å¢åŠ replication.factoråˆ°3` |
| `æ¶ˆè´¹é‡å¤` | `è‡ªåŠ¨æäº¤è¿‡æ—©` | `æ”¹ä¸ºæ‰‹åŠ¨æäº¤offset` |
| `æ¶ˆè´¹ä¸¢å¤±` | `å¼‚å¸¸æ—¶ä»æäº¤offset` | `å¼‚å¸¸æ—¶ä¸æäº¤ï¼Œé‡è¯•å¤„ç†` |

### 5.2 æ€§èƒ½ä¸å¯é æ€§å¹³è¡¡


**âš–ï¸ é…ç½®æƒè¡¡å»ºè®®**

```
ä¸åŒä¸šåŠ¡åœºæ™¯çš„é…ç½®å»ºè®®ï¼š

ğŸ”´ æé«˜å¯é æ€§ (é‡‘èæ”¯ä»˜)
â”œâ”€â”€ acks=all
â”œâ”€â”€ replication.factor=3  
â”œâ”€â”€ min.insync.replicas=2
â”œâ”€â”€ enable.auto.commit=false
â””â”€â”€ retries=MAX_INT

ğŸŸ¡ å¹³è¡¡å‹ (è®¢å•ç³»ç»Ÿ)
â”œâ”€â”€ acks=1
â”œâ”€â”€ replication.factor=3
â”œâ”€â”€ min.insync.replicas=1  
â”œâ”€â”€ enable.auto.commit=false
â””â”€â”€ retries=3

ğŸŸ¢ é«˜æ€§èƒ½ (æ—¥å¿—æ”¶é›†)
â”œâ”€â”€ acks=0
â”œâ”€â”€ replication.factor=1
â”œâ”€â”€ enable.auto.commit=true
â””â”€â”€ retries=0
```

### 5.3 ç›‘æ§æŒ‡æ ‡è®¾ç½®


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**

```bash
# ç”Ÿäº§è€…ç›‘æ§
kafka.producer:type=producer-metrics,client-id=*,attribute=record-error-rate
kafka.producer:type=producer-metrics,client-id=*,attribute=record-retry-rate

# Brokerç›‘æ§  
kafka.server:type=ReplicaManager,name=UnderReplicatedPartitions
kafka.server:type=ReplicaManager,name=PartitionCount

# æ¶ˆè´¹è€…ç›‘æ§
kafka.consumer:type=consumer-metrics,client-id=*,attribute=records-lag-max
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„å¯é æ€§é…ç½®


```
ğŸ”¸ ç”Ÿäº§è€…ç«¯ï¼šacks=all + é‡è¯•æœºåˆ¶ + å¹‚ç­‰æ€§
ğŸ”¸ Brokerç«¯ï¼š3å‰¯æœ¬ + min.insync.replicas=2 + ç¦ç”¨è„é€‰ä¸¾  
ğŸ”¸ æ¶ˆè´¹è€…ç«¯ï¼šæ‰‹åŠ¨æäº¤offset + å¼‚å¸¸é‡è¯•
ğŸ”¸ ç›‘æ§ï¼šå…³é”®æŒ‡æ ‡ç›‘æ§ + å‘Šè­¦æœºåˆ¶
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¯é æ€§çš„æœ¬è´¨**
```
å¯é æ€§ = å†—ä½™ + ç¡®è®¤ + é‡è¯•
- å†—ä½™ï¼šå¤šå‰¯æœ¬é˜²æ­¢å•ç‚¹æ•…éšœ
- ç¡®è®¤ï¼šacksæœºåˆ¶ä¿è¯å†™å…¥æˆåŠŸ  
- é‡è¯•ï¼šå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
```

**ğŸ”¹ æ€§èƒ½ä¸å¯é æ€§çš„æƒè¡¡**
```
é«˜å¯é æ€§ â†’ æ›´å¤šç½‘ç»œäº¤äº’ â†’ æ€§èƒ½ä¸‹é™
é«˜æ€§èƒ½   â†’ å‡å°‘ç¡®è®¤æ­¥éª¤ â†’ å¯é æ€§é™ä½
éœ€è¦æ ¹æ®ä¸šåŠ¡é‡è¦æ€§é€‰æ‹©åˆé€‚çš„å¹³è¡¡ç‚¹
```

### 6.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ† æ¨èé…ç½®æ¨¡æ¿**

```java
// ç”Ÿäº§è€…æœ€ä½³å®è·µé…ç½®
acks=all
retries=2147483647  
enable.idempotence=true
delivery.timeout.ms=120000

// Brokeræœ€ä½³å®è·µé…ç½®  
replication.factor=3
min.insync.replicas=2
unclean.leader.election.enable=false

// æ¶ˆè´¹è€…æœ€ä½³å®è·µé…ç½®
enable.auto.commit=false
max.poll.records=100
session.timeout.ms=30000
```

**ğŸ¯ æ•…éšœé¢„é˜²æªæ–½**
- **å®šæœŸå¤‡ä»½**ï¼šé‡è¦Topicé…ç½®å’Œæ•°æ®å¤‡ä»½
- **å®¹é‡è§„åˆ’**ï¼šç£ç›˜ã€ç½‘ç»œã€å†…å­˜å®¹é‡ç›‘æ§  
- **æ•…éšœæ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œæ•…éšœæ¢å¤æ¼”ç»ƒ
- **ç‰ˆæœ¬ç®¡ç†**ï¼šKafkaç‰ˆæœ¬å‡çº§ç­–ç•¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ¶ˆæ¯å¯é ä¸‰è¦ç´ ï¼šå‘é€è¦ç¡®è®¤ï¼Œå­˜å‚¨è¦å¤‡ä»½ï¼Œæ¶ˆè´¹è¦æ‰‹åŠ¨
ç”Ÿäº§acksè®¾allï¼Œå‰¯æœ¬æ•°è¦ä¸‰ï¼Œæ¶ˆè´¹è€…æ‰‹åŠ¨æäº¤ä¸èƒ½å¿˜
```