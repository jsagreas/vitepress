---
title: 14ã€ksqlå®¢æˆ·ç«¯é…ç½®
---
## ğŸ“š ç›®å½•

1. [KSQLåŸºç¡€æ¦‚å¿µ](#1-KSQLåŸºç¡€æ¦‚å¿µ)
2. [æ ¸å¿ƒæµå¤„ç†é…ç½®](#2-æ ¸å¿ƒæµå¤„ç†é…ç½®)
3. [å¤–éƒ¨æœåŠ¡è¿æ¥é…ç½®](#3-å¤–éƒ¨æœåŠ¡è¿æ¥é…ç½®)
4. [å®‰å…¨è®¤è¯é…ç½®](#4-å®‰å…¨è®¤è¯é…ç½®)
5. [ç”Ÿäº§è€…é…ç½®ä¼˜åŒ–](#5-ç”Ÿäº§è€…é…ç½®ä¼˜åŒ–)
6. [é…ç½®å®æˆ˜æ¡ˆä¾‹](#6-é…ç½®å®æˆ˜æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ KSQLåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯KSQLï¼Ÿ


**ğŸ”¸ é€šä¿—ç†è§£**
```
KSQLå°±åƒç»™Kafkaè£…äº†ä¸€ä¸ª"ç¿»è¯‘å™¨"ï¼š
â€¢ åŸæœ¬éœ€è¦å†™å¤æ‚Javaä»£ç å¤„ç†æ•°æ®æµ
â€¢ ç°åœ¨å¯ä»¥ç”¨ç±»ä¼¼SQLçš„è¯­è¨€å¤„ç†
â€¢ å°±åƒç”¨Excelå…¬å¼å¤„ç†æ•°æ®ï¼Œä½†æ˜¯å®æ—¶çš„ï¼

ä¸¾ä¸ªä¾‹å­ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šå†™å‡ ç™¾è¡ŒJavaä»£ç ç»Ÿè®¡ç½‘ç«™è®¿é—®é‡
KSQLæ–¹å¼ï¼šä¸€æ¡SQLè¯­å¥æå®š
```

**ğŸ’¡ æ ¸å¿ƒä½œç”¨**
```
KSQL = SQL + å®æ—¶æµå¤„ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹æ•°æ®æµ  â”‚ â†’  â”‚ KSQLå¤„ç†å¼•æ“ â”‚ â†’  â”‚  ç»“æœæ•°æ®æµ  â”‚
â”‚(ç”¨æˆ·ç‚¹å‡»)   â”‚    â”‚(ç±»ä¼¼æ•°æ®åº“)  â”‚    â”‚ (ç»Ÿè®¡ç»“æœ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 é…ç½®æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ


**ğŸ“ å¸¸è§ä½ç½®**
```
Linux/Mac:
/opt/kafka/config/ksql-server.properties

Windows:
C:\kafka\config\ksql-server.properties

Dockerç¯å¢ƒ:
é€šè¿‡ç¯å¢ƒå˜é‡æˆ–æŒ‚è½½é…ç½®æ–‡ä»¶
```

**ğŸ¯ é…ç½®æ–‡ä»¶ä½œç”¨**
- å‘Šè¯‰KSQLæ€ä¹ˆè¿æ¥Kafka
- è®¾ç½®å®‰å…¨è®¤è¯å‚æ•°
- ä¼˜åŒ–æ€§èƒ½è¡¨ç°
- é›†æˆå¤–éƒ¨æœåŠ¡

---

## 2. âš¡ æ ¸å¿ƒæµå¤„ç†é…ç½®


### 2.1 åç§»é‡é‡ç½®é…ç½®


**ğŸ”¸ ksql.streams.auto.offset.reset**

**å«ä¹‰è§£é‡Š**
```
è¿™ä¸ªé…ç½®å†³å®šï¼šå½“KSQLåº”ç”¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œä»å“ªé‡Œå¼€å§‹è¯»å–æ•°æ®

å°±åƒçœ‹ç”µè§†å‰§ï¼š
â€¢ earliest: ä»ç¬¬1é›†å¼€å§‹çœ‹ï¼ˆä»æœ€æ—©çš„æ•°æ®å¼€å§‹ï¼‰
â€¢ latest: ä»æœ€æ–°ä¸€é›†å¼€å§‹çœ‹ï¼ˆåªå¤„ç†æ–°æ•°æ®ï¼‰
```

**é…ç½®ç¤ºä¾‹**
```properties
# ä»æœ€æ—©çš„æ•°æ®å¼€å§‹å¤„ç†ï¼ˆé€‚åˆæ•°æ®åˆ†æï¼‰
ksql.streams.auto.offset.reset=earliest

# åªå¤„ç†æœ€æ–°æ•°æ®ï¼ˆé€‚åˆå®æ—¶ç›‘æ§ï¼‰
ksql.streams.auto.offset.reset=latest
```

**ğŸ“Š é€‰æ‹©æŒ‡å—**
| åœºæ™¯ | æ¨èé…ç½® | åŸå›  |
|------|----------|------|
| ğŸ” **æ•°æ®åˆ†æ** | `earliest` | éœ€è¦å¤„ç†å†å²æ•°æ® |
| ğŸ“Š **å®æ—¶ç›‘æ§** | `latest` | åªå…³å¿ƒå½“å‰çŠ¶æ€ |
| ğŸ§ª **å¼€å‘æµ‹è¯•** | `earliest` | ä¾¿äºéªŒè¯é€»è¾‘ |

### 2.2 ç¼“å­˜å¤§å°é…ç½®


**ğŸ”¸ ksql.streams.cache.max.bytes.buffering**

**é€šä¿—è§£é‡Š**
```
è¿™å°±åƒç”µè„‘çš„å†…å­˜ï¼š
â€¢ ç¼“å­˜è¶Šå¤§ï¼Œå¤„ç†æ•°æ®è¶Šå¿«
â€¢ ä½†å ç”¨å†…å­˜ä¹Ÿè¶Šå¤š
â€¢ éœ€è¦åœ¨é€Ÿåº¦å’Œèµ„æºä¹‹é—´å¹³è¡¡

æ¯”å¦‚ï¼š
ç¼“å­˜10MB: å°æ–‡ä»¶å¤„ç†å¿«ï¼Œå¤§æ–‡ä»¶å¯èƒ½å¡é¡¿
ç¼“å­˜100MB: å¤§æ–‡ä»¶å¤„ç†æµç•…ï¼Œä½†å ç”¨æ›´å¤šå†…å­˜
```

**é…ç½®å»ºè®®**
```properties
# å°è§„æ¨¡åº”ç”¨ï¼ˆå‡ åƒæ¡/ç§’ï¼‰
ksql.streams.cache.max.bytes.buffering=10485760

# ä¸­ç­‰è§„æ¨¡åº”ç”¨ï¼ˆå‡ ä¸‡æ¡/ç§’ï¼‰  
ksql.streams.cache.max.bytes.buffering=52428800

# å¤§è§„æ¨¡åº”ç”¨ï¼ˆåä¸‡æ¡/ç§’ä»¥ä¸Šï¼‰
ksql.streams.cache.max.bytes.buffering=104857600
```

ğŸ’¡ **è®°å¿†æŠ€å·§**
```
10485760 â‰ˆ 10MB (10 * 1024 * 1024)
52428800 â‰ˆ 50MB  
104857600 â‰ˆ 100MB
```

### 2.3 æ—¶é—´æˆ³æå–å™¨é…ç½®


**ğŸ”¸ ksql.streams.default.timestamp.extractor**

**æ¦‚å¿µè§£é‡Š**
```
æ—¶é—´æˆ³æå–å™¨å°±åƒæ•°æ®çš„"æ—¶é—´æ ‡ç­¾æœº"ï¼š
å†³å®šç”¨ä»€ä¹ˆæ—¶é—´æ¥ç»™æ•°æ®æ’åºå’Œå¤„ç†

ä¸‰ç§æ–¹å¼ï¼š
1. ç”¨æ•°æ®æœ¬èº«çš„æ—¶é—´æˆ³ï¼ˆæ•°æ®åˆ›å»ºæ—¶é—´ï¼‰
2. ç”¨æ¶ˆæ¯åˆ°è¾¾Kafkaçš„æ—¶é—´  
3. ç”¨KSQLå¤„ç†æ—¶çš„å½“å‰æ—¶é—´
```

**å¸¸ç”¨é…ç½®**
```properties
# ä½¿ç”¨æ¶ˆæ¯è‡ªå¸¦çš„æ—¶é—´æˆ³ï¼ˆæœ€å¸¸ç”¨ï¼‰
ksql.streams.default.timestamp.extractor=org.apache.kafka.streams.processor.FailOnInvalidTimestamp

# ä½¿ç”¨æ¶ˆæ¯åˆ°è¾¾æ—¶é—´ï¼ˆç½‘ç»œå»¶è¿Ÿå¤§æ—¶ä½¿ç”¨ï¼‰
ksql.streams.default.timestamp.extractor=org.apache.kafka.streams.processor.LogAndSkipOnInvalidTimestamp
```

**ğŸ¯ ä½¿ç”¨åœºæ™¯**
```
ç”µå•†è®¢å•å¤„ç†ï¼š
â€¢ ç”¨è®¢å•åˆ›å»ºæ—¶é—´ â†’ åˆ†æç”¨æˆ·è´­ä¹°æ¨¡å¼
â€¢ ç”¨æ¶ˆæ¯åˆ°è¾¾æ—¶é—´ â†’ ç›‘æ§ç³»ç»Ÿå¤„ç†å»¶è¿Ÿ

æ—¥å¿—åˆ†æï¼š
â€¢ ç”¨æ—¥å¿—ç”Ÿæˆæ—¶é—´ â†’ å‡†ç¡®çš„æ—¶åºåˆ†æ
â€¢ ç”¨å¤„ç†æ—¶é—´ â†’ å®æ—¶å‘Šè­¦
```

### 2.4 UDFåŠŸèƒ½é…ç½®


**ğŸ”¸ ksql.udfs.enabled**

**ç®€å•ç†è§£**
```
UDF = User Defined Functionï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼‰

å°±åƒExcelä¸­å¯ä»¥è‡ªå®šä¹‰å…¬å¼ï¼š
â€¢ ç³»ç»Ÿè‡ªå¸¦ï¼šSUMã€COUNTã€AVG
â€¢ è‡ªå®šä¹‰ï¼šæ¯”å¦‚è®¡ç®—ç”¨æˆ·æ´»è·ƒåº¦çš„å¤æ‚å…¬å¼

KSQLä¹Ÿä¸€æ ·ï¼Œå¯ä»¥æ‰©å±•è‡ªå®šä¹‰å¤„ç†å‡½æ•°
```

**é…ç½®æ–¹å¼**
```properties
# å¯ç”¨UDFåŠŸèƒ½ï¼ˆæ¨èï¼‰
ksql.udfs.enabled=true

# ç¦ç”¨UDFåŠŸèƒ½ï¼ˆé«˜å®‰å…¨è¦æ±‚ç¯å¢ƒï¼‰
ksql.udfs.enabled=false
```

**âš ï¸ å®‰å…¨æç¤º**
> UDFè™½ç„¶çµæ´»ï¼Œä½†å¯èƒ½å¸¦æ¥å®‰å…¨é£é™©ã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®è°¨æ…å¯ç”¨ã€‚

---

## 3. ğŸ”— å¤–éƒ¨æœåŠ¡è¿æ¥é…ç½®


### 3.1 Kafka Connecté›†æˆ


**ğŸ”¸ ksql.connect.url**

**ä½œç”¨è¯´æ˜**
```
Kafka Connectå°±åƒæ•°æ®çš„"æ¬è¿å·¥"ï¼š
â€¢ æŠŠå¤–éƒ¨æ•°æ®åº“çš„æ•°æ®æ¬åˆ°Kafka
â€¢ æŠŠKafkaçš„æ•°æ®æ¬åˆ°å¤–éƒ¨ç³»ç»Ÿ

KSQLé€šè¿‡è¿™ä¸ªé…ç½®è¿æ¥Connectï¼š
å¯ä»¥åœ¨KSQLä¸­ç›´æ¥ç®¡ç†æ•°æ®è¿æ¥å™¨
```

**é…ç½®ç¤ºä¾‹**
```properties
# å•ä¸ªConnectæœåŠ¡
ksql.connect.url=http://localhost:8083

# å¤šä¸ªConnectæœåŠ¡ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
ksql.connect.url=http://connect1:8083,http://connect2:8083
```

**ğŸ¯ å®é™…åº”ç”¨**
```
æ•°æ®å¤„ç†æµç¨‹ï¼š
MySQLæ•°æ®åº“ â†’ Connect â†’ Kafka â†’ KSQLå¤„ç† â†’ è¾“å‡ºç»“æœ

åœ¨KSQLä¸­å¯ä»¥ï¼š
â€¢ æŸ¥çœ‹æ‰€æœ‰è¿æ¥å™¨çŠ¶æ€
â€¢ åˆ›å»ºæ–°çš„æ•°æ®è¿æ¥å™¨  
â€¢ ç›‘æ§æ•°æ®åŒæ­¥è¿›åº¦
```

### 3.2 Schema Registryé›†æˆ


**ğŸ”¸ ksql.schema.registry.url**

**é€šä¿—è§£é‡Š**
```
Schema Registryå°±åƒæ•°æ®çš„"æ ¼å¼è¯´æ˜ä¹¦"ï¼š
â€¢ å®šä¹‰æ•°æ®çš„ç»“æ„å’Œç±»å‹
â€¢ ä¿è¯æ•°æ®æ ¼å¼çš„ä¸€è‡´æ€§
â€¢ æ”¯æŒæ•°æ®æ ¼å¼çš„ç‰ˆæœ¬ç®¡ç†

å°±åƒAPIæ–‡æ¡£ï¼Œå‘Šè¯‰å¤§å®¶æ•°æ®é•¿ä»€ä¹ˆæ ·
```

**é…ç½®æ–¹æ³•**
```properties
# Schema RegistryæœåŠ¡åœ°å€
ksql.schema.registry.url=http://localhost:8081

# é«˜å¯ç”¨é…ç½®
ksql.schema.registry.url=http://schema1:8081,http://schema2:8081
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦Schema Registryï¼Ÿ**
```
åœºæ™¯å¯¹æ¯”ï¼š

æ²¡æœ‰Schema Registry:
ç”¨æˆ·ä¿¡æ¯ â†’ {"name": "å¼ ä¸‰", "age": "25"} (ageæ˜¯å­—ç¬¦ä¸²)
è®¢å•ä¿¡æ¯ â†’ {"user": "å¼ ä¸‰", "age": 25} (ageæ˜¯æ•°å­—)
å¤„ç†æ—¶å‡ºé”™ï¼å­—æ®µåå’Œç±»å‹ä¸ä¸€è‡´

æœ‰Schema Registry:
ç»Ÿä¸€å®šä¹‰ â†’ {"name": string, "age": integer}
æ‰€æœ‰ç³»ç»Ÿéƒ½æŒ‰è¿™ä¸ªæ ¼å¼ï¼Œä¸ä¼šå‡ºé”™
```

---

## 4. ğŸ”’ å®‰å…¨è®¤è¯é…ç½®


### 4.1 SSLè¯ä¹¦é…ç½®


**ğŸ”¸ ssl.truststore.location & ssl.keystore.location**

**å®‰å…¨æ¦‚å¿µè§£é‡Š**
```
SSLå°±åƒç½‘ç»œé€šä¿¡çš„"ä¿é™©ç®±"ï¼š
â€¢ truststore: å­˜æ”¾ä¿¡ä»»çš„è¯ä¹¦ï¼ˆç›¸å½“äºé€šè®¯å½•ï¼‰
â€¢ keystore: å­˜æ”¾è‡ªå·±çš„è¯ä¹¦å’Œç§é’¥ï¼ˆç›¸å½“äºèº«ä»½è¯ï¼‰

é€šä¿¡è¿‡ç¨‹ï¼š
1. æˆ‘æ‹¿å‡ºèº«ä»½è¯ï¼ˆkeystoreï¼‰è¯æ˜èº«ä»½
2. æ£€æŸ¥å¯¹æ–¹æ˜¯å¦åœ¨é€šè®¯å½•ï¼ˆtruststoreï¼‰ä¸­
3. åŒæ–¹ç¡®è®¤èº«ä»½åï¼Œå»ºç«‹åŠ å¯†é€šé“
```

**é…ç½®ç¤ºä¾‹**
```properties
# ä¿¡ä»»åº“é…ç½®ï¼ˆå­˜æ”¾CAè¯ä¹¦ï¼‰
ssl.truststore.location=/opt/kafka/ssl/kafka.client.truststore.jks
ssl.truststore.password=truststore-password

# å¯†é’¥åº“é…ç½®ï¼ˆå­˜æ”¾å®¢æˆ·ç«¯è¯ä¹¦ï¼‰
ssl.keystore.location=/opt/kafka/ssl/kafka.client.keystore.jks  
ssl.keystore.password=keystore-password
ssl.key.password=key-password
```

**ğŸ“ è¯ä¹¦æ–‡ä»¶å‡†å¤‡**
```bash
# 1. åˆ›å»ºSSLç›®å½•
mkdir -p /opt/kafka/ssl

# 2. å°†è¯ä¹¦æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šä½ç½®
cp kafka.client.truststore.jks /opt/kafka/ssl/
cp kafka.client.keystore.jks /opt/kafka/ssl/

# 3. è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 /opt/kafka/ssl/*.jks
```

### 4.2 SASLè®¤è¯é…ç½®


**ğŸ”¸ sasl.mechanism**

**è®¤è¯æœºåˆ¶è§£é‡Š**
```
SASLå°±åƒä¸åŒçš„"é—¨ç¦ç³»ç»Ÿ"ï¼š

PLAIN: ç”¨æˆ·å+å¯†ç ï¼ˆç®€å•ä½†éœ€è¦SSLä¿æŠ¤ï¼‰
SCRAM: åŠ å¯†çš„ç”¨æˆ·å+å¯†ç ï¼ˆæ›´å®‰å…¨ï¼‰
GSSAPI: ä¼ä¸šçº§Kerberosè®¤è¯ï¼ˆæœ€å®‰å…¨ä½†å¤æ‚ï¼‰

é€‰æ‹©åŸåˆ™ï¼š
â€¢ å¼€å‘æµ‹è¯• â†’ PLAIN
â€¢ ç”Ÿäº§ç¯å¢ƒ â†’ SCRAM  
â€¢ ä¼ä¸šç¯å¢ƒ â†’ GSSAPI
```

**é…ç½®ç¤ºä¾‹**
```properties
# SCRAM-SHA-256è®¤è¯ï¼ˆæ¨èï¼‰
sasl.mechanism=SCRAM-SHA-256
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \
    username="ksql-user" \
    password="ksql-password";

# PLAINè®¤è¯ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
sasl.mechanism=PLAIN
sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required \
    username="ksql-user" \
    password="ksql-password";
```

### 4.3 å®‰å…¨åè®®é…ç½®


**ğŸ”¸ security.protocol**

**åè®®ç»„åˆè¯´æ˜**
```
å®‰å…¨åè®® = ä¼ è¾“åŠ å¯† + èº«ä»½è®¤è¯

å››ç§ç»„åˆï¼š
PLAINTEXT: æ— åŠ å¯†æ— è®¤è¯ï¼ˆä»…å†…ç½‘æµ‹è¯•ï¼‰
SSL: æœ‰åŠ å¯†æ— è®¤è¯ï¼ˆåŸºç¡€å®‰å…¨ï¼‰
SASL_PLAINTEXT: æ— åŠ å¯†æœ‰è®¤è¯ï¼ˆä¸æ¨èï¼‰
SASL_SSL: æœ‰åŠ å¯†æœ‰è®¤è¯ï¼ˆç”Ÿäº§æ¨èï¼‰
```

**é…ç½®é€‰æ‹©**
```properties
# ç”Ÿäº§ç¯å¢ƒï¼ˆæœ€å®‰å…¨ï¼‰
security.protocol=SASL_SSL

# å†…ç½‘ç¯å¢ƒï¼ˆSSLåŠ å¯†ï¼‰
security.protocol=SSL

# å¼€å‘æµ‹è¯•ï¼ˆæ— å®‰å…¨ï¼‰
security.protocol=PLAINTEXT
```

**ğŸ›¡ï¸ å®‰å…¨ç­‰çº§å¯¹æ¯”**
```
å®‰å…¨çº§åˆ«ï¼š
SASL_SSL    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% æœ€å®‰å…¨
SSL         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  80% è¾ƒå®‰å…¨
SASL_PLAINTEXT â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  60% ä¸€èˆ¬
PLAINTEXT   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0% ä¸å®‰å…¨
```

---

## 5. ğŸ“¤ ç”Ÿäº§è€…é…ç½®ä¼˜åŒ–


### 5.1 é‡è¯•æœºåˆ¶é…ç½®


**ğŸ”¸ ksql.streams.producer.retries**

**é‡è¯•æœºåˆ¶è§£é‡Š**
```
é‡è¯•å°±åƒå¿«é€’æŠ•é€’ï¼š
â€¢ ç¬¬ä¸€æ¬¡æŠ•é€’å¤±è´¥ï¼ˆç½‘ç»œæ³¢åŠ¨ï¼‰
â€¢ å¿«é€’å‘˜ä¼šé‡è¯•å‡ æ¬¡
â€¢ è¶…è¿‡é‡è¯•æ¬¡æ•°å°±æ”¾å¼ƒ

KSQLå‘é€æ•°æ®ä¹Ÿæ˜¯è¿™æ ·ï¼š
å¤±è´¥äº†ä¼šè‡ªåŠ¨é‡è¯•ï¼Œæé«˜æ•°æ®ä¼ è¾“æˆåŠŸç‡
```

**é…ç½®å»ºè®®**
```properties
# ç”Ÿäº§ç¯å¢ƒï¼ˆå¯é æ€§ä¼˜å…ˆï¼‰
ksql.streams.producer.retries=2147483647

# å¼€å‘ç¯å¢ƒï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰
ksql.streams.producer.retries=3

# å®æ—¶è¦æ±‚é«˜çš„åœºæ™¯
ksql.streams.producer.retries=1
```

**â±ï¸ é‡è¯•ç­–ç•¥**
```
é‡è¯•é—´éš”ä¼šé€æ¸å¢åŠ ï¼š
ç¬¬1æ¬¡é‡è¯•: ç«‹å³
ç¬¬2æ¬¡é‡è¯•: 100mså
ç¬¬3æ¬¡é‡è¯•: 200mså  
ç¬¬4æ¬¡é‡è¯•: 400mså
...ä»¥æ­¤ç±»æ¨
```

### 5.2 åº”ç­”æœºåˆ¶é…ç½®


**ğŸ”¸ ksql.streams.producer.acks**

**åº”ç­”æœºåˆ¶è§£é‡Š**
```
ackså†³å®šä»€ä¹ˆæ—¶å€™è®¤ä¸º"æ•°æ®å‘é€æˆåŠŸ"ï¼š

acks=0: å‘äº†å°±ç®—æˆåŠŸï¼ˆæœ€å¿«ï¼Œä½†å¯èƒ½ä¸¢æ•°æ®ï¼‰
å°±åƒå‘çŸ­ä¿¡ä¸è¦æ±‚å›æ‰§

acks=1: Leaderæ”¶åˆ°å°±ç®—æˆåŠŸï¼ˆå¹³è¡¡ï¼‰  
å°±åƒå¿«é€’é€è¾¾ç­¾æ”¶

acks=all: æ‰€æœ‰å‰¯æœ¬éƒ½æ”¶åˆ°æ‰ç®—æˆåŠŸï¼ˆæœ€å¯é ï¼‰
å°±åƒé‡è¦æ–‡ä»¶éœ€è¦å¤šäººç­¾æ”¶ç¡®è®¤
```

**é…ç½®é€‰æ‹©**
```properties
# æ•°æ®å¯é æ€§è¦æ±‚é«˜ï¼ˆæ¨èï¼‰
ksql.streams.producer.acks=all

# æ€§èƒ½è¦æ±‚é«˜ï¼Œå°‘é‡ä¸¢å¤±å¯æ¥å—
ksql.streams.producer.acks=1

# ä»…æµ‹è¯•ç¯å¢ƒï¼Œè¿½æ±‚æè‡´æ€§èƒ½
ksql.streams.producer.acks=0
```

**âš–ï¸ æ€§èƒ½ä¸å¯é æ€§æƒè¡¡**
```
å¯é æ€§: acks=all > acks=1 > acks=0
æ€§èƒ½:   acks=0 > acks=1 > acks=all

ä¸šåŠ¡é€‰æ‹©ï¼š
â€¢ é‡‘èäº¤æ˜“ â†’ acks=allï¼ˆä¸èƒ½ä¸¢æ•°æ®ï¼‰
â€¢ ç”¨æˆ·è¡Œä¸º â†’ acks=1ï¼ˆå¹³è¡¡é€‰æ‹©ï¼‰
â€¢ æ—¥å¿—æ”¶é›† â†’ acks=0ï¼ˆå¶å°”ä¸¢å¤±å¯æ¥å—ï¼‰
```

---

## 6. ğŸš€ é…ç½®å®æˆ˜æ¡ˆä¾‹


### 6.1 å¼€å‘ç¯å¢ƒé…ç½®


**ğŸ“ å®Œæ•´é…ç½®æ–‡ä»¶**
```properties
# ===========================================
# KSQLå¼€å‘ç¯å¢ƒé…ç½®
# ===========================================

# åŸºç¡€è¿æ¥é…ç½®
bootstrap.servers=localhost:9092
ksql.service.id=dev_ksql_service

# æµå¤„ç†é…ç½®ï¼ˆå¼€å‘å‹å¥½ï¼‰
ksql.streams.auto.offset.reset=earliest
ksql.streams.cache.max.bytes.buffering=10485760
ksql.streams.default.timestamp.extractor=org.apache.kafka.streams.processor.FailOnInvalidTimestamp

# åŠŸèƒ½å¼€å…³
ksql.udfs.enabled=true

# å¤–éƒ¨æœåŠ¡
ksql.connect.url=http://localhost:8083
ksql.schema.registry.url=http://localhost:8081

# å®‰å…¨é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
security.protocol=PLAINTEXT

# ç”Ÿäº§è€…é…ç½®ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰
ksql.streams.producer.retries=3
ksql.streams.producer.acks=1
```

### 6.2 ç”Ÿäº§ç¯å¢ƒé…ç½®


**ğŸ“ å®Œæ•´é…ç½®æ–‡ä»¶**
```properties
# ===========================================
# KSQLç”Ÿäº§ç¯å¢ƒé…ç½®
# ===========================================

# åŸºç¡€è¿æ¥é…ç½®
bootstrap.servers=kafka1:9092,kafka2:9092,kafka3:9092
ksql.service.id=prod_ksql_service

# æµå¤„ç†é…ç½®ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
ksql.streams.auto.offset.reset=latest
ksql.streams.cache.max.bytes.buffering=52428800
ksql.streams.default.timestamp.extractor=org.apache.kafka.streams.processor.FailOnInvalidTimestamp

# åŠŸèƒ½å¼€å…³ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
ksql.udfs.enabled=false

# å¤–éƒ¨æœåŠ¡ï¼ˆé«˜å¯ç”¨ï¼‰
ksql.connect.url=http://connect1:8083,http://connect2:8083
ksql.schema.registry.url=http://schema1:8081,http://schema2:8081

# å®‰å…¨é…ç½®ï¼ˆå®Œæ•´å®‰å…¨ï¼‰
security.protocol=SASL_SSL
sasl.mechanism=SCRAM-SHA-256
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \
    username="ksql-prod-user" \
    password="complex-password-123";

# SSLè¯ä¹¦é…ç½®
ssl.truststore.location=/opt/kafka/ssl/kafka.client.truststore.jks
ssl.truststore.password=truststore-password
ssl.keystore.location=/opt/kafka/ssl/kafka.client.keystore.jks
ssl.keystore.password=keystore-password
ssl.key.password=key-password

# ç”Ÿäº§è€…é…ç½®ï¼ˆå¯é æ€§ä¼˜å…ˆï¼‰
ksql.streams.producer.retries=2147483647
ksql.streams.producer.acks=all
```

### 6.3 é…ç½®éªŒè¯æ–¹æ³•


**ğŸ” é…ç½®æ£€æŸ¥æ¸…å•**
```bash
# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
ksql-server-start /path/to/ksql-server.properties --dry-run

# 2. æµ‹è¯•Kafkaè¿æ¥
kafka-topics --bootstrap-server localhost:9092 --list

# 3. æµ‹è¯•Schema Registryè¿æ¥  
curl http://localhost:8081/subjects

# 4. æµ‹è¯•Connectè¿æ¥
curl http://localhost:8083/connectors
```

**ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```
å…³é”®ç›‘æ§é¡¹ï¼š
â€¢ æ¶ˆæ¯å¤„ç†å»¶è¿Ÿ: < 100ms
â€¢ é”™è¯¯ç‡: < 0.1%  
â€¢ å†…å­˜ä½¿ç”¨ç‡: < 80%
â€¢ CPUä½¿ç”¨ç‡: < 70%
â€¢ ç½‘ç»œè¿æ¥æ•°: æ­£å¸¸èŒƒå›´å†…
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒé…ç½®


```
ğŸ”¸ æµå¤„ç†é…ç½®ï¼š
auto.offset.reset â†’ å†³å®šä»å“ªé‡Œå¼€å§‹å¤„ç†æ•°æ®
cache.max.bytes.buffering â†’ å½±å“å¤„ç†æ€§èƒ½
timestamp.extractor â†’ ç¡®å®šæ•°æ®æ—¶é—´åŸºå‡†

ğŸ”¸ å¤–éƒ¨æœåŠ¡é›†æˆï¼š
connect.url â†’ è¿æ¥æ•°æ®åŒæ­¥æœåŠ¡
schema.registry.url â†’ è¿æ¥æ•°æ®æ ¼å¼ç®¡ç†

ğŸ”¸ å®‰å…¨è®¤è¯ï¼š
security.protocol â†’ é€‰æ‹©å®‰å…¨çº§åˆ«
sasl.mechanism â†’ é€‰æ‹©è®¤è¯æ–¹å¼
SSLè¯ä¹¦é…ç½® â†’ ä¿è¯ä¼ è¾“å®‰å…¨

ğŸ”¸ ç”Ÿäº§è€…ä¼˜åŒ–ï¼š
producer.retries â†’ æé«˜æ•°æ®æŠ•é€’æˆåŠŸç‡
producer.acks â†’ å¹³è¡¡æ€§èƒ½ä¸å¯é æ€§
```

### 7.2 é…ç½®é€‰æ‹©åŸåˆ™


**ğŸ¯ ç¯å¢ƒå¯¹åº”é…ç½®ç­–ç•¥**
```
å¼€å‘ç¯å¢ƒï¼š
â€¢ åç§»é‡: earliestï¼ˆä¾¿äºæµ‹è¯•ï¼‰
â€¢ å®‰å…¨: PLAINTEXTï¼ˆç®€åŒ–é…ç½®ï¼‰
â€¢ é‡è¯•: è¾ƒå°‘ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰
â€¢ UDF: å¯ç”¨ï¼ˆåŠŸèƒ½æµ‹è¯•ï¼‰

ç”Ÿäº§ç¯å¢ƒï¼š
â€¢ åç§»é‡: latestï¼ˆé¿å…é‡å¤å¤„ç†ï¼‰
â€¢ å®‰å…¨: SASL_SSLï¼ˆå®Œæ•´ä¿æŠ¤ï¼‰  
â€¢ é‡è¯•: æ— é™ï¼ˆä¿è¯å¯é æ€§ï¼‰
â€¢ UDF: è°¨æ…å¯ç”¨ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
```

**âš–ï¸ æ€§èƒ½ä¸å®‰å…¨æƒè¡¡**
```
é«˜æ€§èƒ½éœ€æ±‚ï¼š
â€¢ å‡å°‘é‡è¯•æ¬¡æ•°
â€¢ é™ä½åº”ç­”è¦æ±‚
â€¢ å¢å¤§ç¼“å­˜ç©ºé—´
â€¢ ç®€åŒ–å®‰å…¨é…ç½®

é«˜å®‰å…¨éœ€æ±‚ï¼š
â€¢ å¯ç”¨å®Œæ•´SSL
â€¢ ä½¿ç”¨å¼ºè®¤è¯æœºåˆ¶  
â€¢ å¢åŠ é‡è¯•ä¿éšœ
â€¢ ç¦ç”¨å±é™©åŠŸèƒ½
```

### 7.3 å¸¸è§é…ç½®é—®é¢˜è§£å†³


**â“ è¿æ¥é—®é¢˜æ’æŸ¥**
```
é—®é¢˜ï¼šæ— æ³•è¿æ¥Kafka
æ£€æŸ¥é¡¹ï¼š
1. bootstrap.serversåœ°å€æ˜¯å¦æ­£ç¡®
2. ç½‘ç»œæ˜¯å¦å¯è¾¾ï¼ˆping/telnetæµ‹è¯•ï¼‰
3. å®‰å…¨é…ç½®æ˜¯å¦åŒ¹é…
4. è¯ä¹¦æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æœ‰æƒé™

è§£å†³æ­¥éª¤ï¼š
1. éªŒè¯ç½‘ç»œè¿é€šæ€§
2. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
3. æŸ¥çœ‹KSQLæœåŠ¡æ—¥å¿—
4. é€æ­¥è°ƒè¯•é…ç½®é¡¹
```

**ğŸ”§ æ€§èƒ½é—®é¢˜ä¼˜åŒ–**
```
é—®é¢˜ï¼šå¤„ç†å»¶è¿Ÿè¿‡é«˜
ä¼˜åŒ–æ–¹å‘ï¼š
1. å¢å¤§ç¼“å­˜é…ç½®
2. è°ƒæ•´æ‰¹å¤„ç†å¤§å°
3. ä¼˜åŒ–ç½‘ç»œé…ç½®
4. æ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µ

ç›‘æ§é‡ç‚¹ï¼š
â€¢ JVMå†…å­˜ä½¿ç”¨
â€¢ ç½‘ç»œå¸¦å®½åˆ©ç”¨ç‡
â€¢ ç£ç›˜IOçŠ¶å†µ
â€¢ Kafkaé›†ç¾¤å¥åº·åº¦
```

### 7.4 å®é™…åº”ç”¨å»ºè®®


**ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“**
- **é…ç½®ç®¡ç†**ï¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®æ–‡ä»¶
- **ç¯å¢ƒéš”ç¦»**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
- **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®å…³é”®æŒ‡æ ‡ç›‘æ§
- **æ–‡æ¡£ç»´æŠ¤**ï¼šåŠæ—¶æ›´æ–°é…ç½®è¯´æ˜æ–‡æ¡£
- **å®‰å…¨å®¡è®¡**ï¼šå®šæœŸæ£€æŸ¥å®‰å…¨é…ç½®

**ğŸš€ å­¦ä¹ å»ºè®®**
- ä»ç®€å•é…ç½®å¼€å§‹ï¼Œé€æ­¥å¢åŠ å¤æ‚åº¦
- åœ¨å¼€å‘ç¯å¢ƒå……åˆ†æµ‹è¯•åå†åº”ç”¨åˆ°ç”Ÿäº§
- ç†è§£æ¯ä¸ªé…ç½®é¡¹çš„å®é™…å½±å“
- ç»“åˆä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„é…ç½®ç­–ç•¥

**æ ¸å¿ƒè®°å¿†**ï¼š
- KSQLé…ç½®å†³å®šäº†æ•°æ®å¤„ç†çš„æ–¹å¼å’Œå®‰å…¨æ€§
- ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒçš„é…ç½®ç­–ç•¥
- æ€§èƒ½å’Œå®‰å…¨éœ€è¦æ ¹æ®å®é™…éœ€æ±‚å¹³è¡¡
- é…ç½®éªŒè¯å’Œç›‘æ§åŒæ ·é‡è¦