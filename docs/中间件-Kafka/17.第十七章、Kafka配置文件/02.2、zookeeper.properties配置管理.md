---
title: 2ã€zookeeper.propertiesé…ç½®ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ZooKeeperåœ¨Kafkaä¸­çš„ä½œç”¨](#1-ZooKeeperåœ¨Kafkaä¸­çš„ä½œç”¨)
2. [é…ç½®æ–‡ä»¶åŸºç¡€çŸ¥è¯†](#2-é…ç½®æ–‡ä»¶åŸºç¡€çŸ¥è¯†)
3. [æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£](#3-æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£)
4. [é›†ç¾¤é…ç½®å®æˆ˜](#4-é›†ç¾¤é…ç½®å®æˆ˜)
5. [æ€§èƒ½è°ƒä¼˜é…ç½®](#5-æ€§èƒ½è°ƒä¼˜é…ç½®)
6. [ç›‘æ§ä¸ç»´æŠ¤é…ç½®](#6-ç›‘æ§ä¸ç»´æŠ¤é…ç½®)
7. [å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ](#7-å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ ZooKeeperåœ¨Kafkaä¸­çš„ä½œç”¨


### 1.1 ä»€ä¹ˆæ˜¯ZooKeeperï¼Ÿ

**ZooKeeperç®€å•ç†è§£**ï¼šå¯ä»¥æŠŠZooKeeperæƒ³è±¡æˆä¸€ä¸ª**è¶…çº§ç®¡å®¶**ï¼Œä¸“é—¨è´Ÿè´£ç®¡ç†å’Œåè°ƒKafkaé›†ç¾¤ä¸­çš„å„ç§äº‹åŠ¡ã€‚

```
ç°å®ä¸­çš„ç®¡å®¶èŒè´£ï¼š              ZooKeeperçš„èŒè´£ï¼š
ç®¡ç†æˆ¿é—´åˆ†é…                 âœ  ç®¡ç†Topicåˆ†åŒºåˆ†é…
åè°ƒå®¶åº­æˆå‘˜å…³ç³»              âœ  åè°ƒBrokerä¹‹é—´å…³ç³»
è®°å½•é‡è¦ä¿¡æ¯                 âœ  å­˜å‚¨é›†ç¾¤å…ƒæ•°æ®
å¤„ç†çªå‘äº‹ä»¶                 âœ  å¤„ç†æ•…éšœè½¬ç§»
```

### 1.2 ZooKeeperçš„æ ¸å¿ƒä½œç”¨


**ğŸ”¸ é›†ç¾¤åè°ƒä¸­å¿ƒ**
- **é€‰ä¸¾Leader**ï¼šå½“Kafkaçš„ControllerèŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼ŒZooKeeperå¸®åŠ©é€‰å‡ºæ–°çš„Controller
- **é…ç½®ç®¡ç†**ï¼šå­˜å‚¨Topicé…ç½®ã€åˆ†åŒºä¿¡æ¯ç­‰é‡è¦æ•°æ®
- **æœåŠ¡å‘ç°**ï¼šå‘Šè¯‰å®¢æˆ·ç«¯å“ªäº›Brokeræ˜¯å¯ç”¨çš„

**ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ä¿éšœ**
```
æ²¡æœ‰ZooKeeperçš„æƒ…å†µï¼š
Broker1: "æˆ‘æ˜¯Leader"
Broker2: "ä¸ï¼Œæˆ‘æ‰æ˜¯Leader"  â† æ··ä¹±çŠ¶æ€

æœ‰äº†ZooKeeperï¼š
ZooKeeper: "Broker1æ˜¯Leaderï¼Œå…¶ä»–äººå¬å®ƒçš„"  â† ç»Ÿä¸€åè°ƒ
```

### 1.3 ZooKeeperä¸Kafkaçš„å…³ç³»å›¾


```
        å®¢æˆ·ç«¯åº”ç”¨
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Kafkaé›†ç¾¤     â”‚
    â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”  â”‚
    â”‚  â”‚B1 â”‚B2 â”‚B3 â”‚  â”‚  â† BrokerèŠ‚ç‚¹
    â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ZooKeeperé›†ç¾¤  â”‚  â† åè°ƒç®¡ç†ä¸­å¿ƒ
    â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”  â”‚
    â”‚  â”‚Z1 â”‚Z2 â”‚Z3 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®æµå‘ï¼š
1. Kafkaä¾èµ–ZooKeeperå­˜å‚¨å…ƒæ•°æ®
2. ZooKeeperç›‘æ§Kafkaé›†ç¾¤çŠ¶æ€
3. å®¢æˆ·ç«¯é€šè¿‡ZooKeeperå‘ç°å¯ç”¨Broker
```

---

## 2. ğŸ“ é…ç½®æ–‡ä»¶åŸºç¡€çŸ¥è¯†


### 2.1 é…ç½®æ–‡ä»¶ä½ç½®ä¸å‘½å

**æ ‡å‡†é…ç½®æ–‡ä»¶è·¯å¾„**ï¼š
```
kafkaå®‰è£…ç›®å½•/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ zookeeper.properties    â† ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ server.properties       â† Kafkaé…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ consumer.properties     â† æ¶ˆè´¹è€…é…ç½®
```

### 2.2 é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜

**ğŸ”¸ åŸºæœ¬æ ¼å¼è§„åˆ™**
```properties
# è¿™æ˜¯æ³¨é‡Šï¼Œç”¨#å¼€å¤´
é…ç½®é¡¹åç§°=é…ç½®å€¼

# ç¤ºä¾‹ï¼š
dataDir=/var/lib/zookeeper
clientPort=2181
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
- ç­‰å·ä¸¤è¾¹**ä¸è¦æœ‰ç©ºæ ¼**ï¼š`dataDir=/path` âœ…  `dataDir = /path` âŒ
- è·¯å¾„ä½¿ç”¨**æ­£æ–œæ **ï¼š`/var/lib/zookeeper` âœ…  `\var\lib\zookeeper` âŒ
- é…ç½®ä¿®æ”¹åéœ€è¦**é‡å¯æœåŠ¡**æ‰èƒ½ç”Ÿæ•ˆ

### 2.3 é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§

```
é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1ï¸âƒ£ å‘½ä»¤è¡Œå‚æ•°
2ï¸âƒ£ é…ç½®æ–‡ä»¶è®¾ç½®
3ï¸âƒ£ ç³»ç»Ÿé»˜è®¤å€¼

ç¤ºä¾‹ï¼š
./zookeeper-server-start.sh config/zoo.cfg --override dataDir=/tmp/zk
                                    â†‘
                              å‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆçº§æœ€é«˜
```

---

## 3. âš™ï¸ æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£


### 3.1 æ•°æ®å­˜å‚¨é…ç½®


#### ğŸ”¸ dataDir - æ•°æ®å­˜å‚¨ç›®å½•

**ä½œç”¨**ï¼šæŒ‡å®šZooKeeperå­˜å‚¨æ•°æ®çš„æ ¹ç›®å½•ï¼Œè¿™æ˜¯æœ€é‡è¦çš„é…ç½®ä¹‹ä¸€ã€‚

```properties
# åŸºæœ¬é…ç½®
dataDir=/var/lib/zookeeper

# ç”Ÿäº§ç¯å¢ƒå»ºè®®
dataDir=/data/zookeeper/data
```

**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
- å°±åƒç»™ZooKeeperæŒ‡å®šä¸€ä¸ª"ä»“åº“"å­˜æ”¾æ‰€æœ‰é‡è¦æ–‡ä»¶
- åŒ…æ‹¬é›†ç¾¤çŠ¶æ€ã€é…ç½®ä¿¡æ¯ã€äº‹åŠ¡æ—¥å¿—ç­‰
- è¿™ä¸ªç›®å½•**å¿…é¡»å­˜åœ¨**ä¸”ZooKeeperè¿›ç¨‹è¦æœ‰**è¯»å†™æƒé™**

**ğŸ”§ æœ€ä½³å®è·µ**ï¼š
```bash
# 1. åˆ›å»ºç›®å½•
sudo mkdir -p /data/zookeeper/data

# 2. è®¾ç½®æƒé™
sudo chown -R zookeeper:zookeeper /data/zookeeper

# 3. ç¡®ä¿ç›®å½•æœ‰è¶³å¤Ÿç©ºé—´ï¼ˆè‡³å°‘10GBï¼‰
df -h /data/zookeeper
```

#### ğŸ”¸ dataLogDir - äº‹åŠ¡æ—¥å¿—ç›®å½•

```properties
# å°†äº‹åŠ¡æ—¥å¿—å’Œæ•°æ®å¿«ç…§åˆ†å¼€å­˜å‚¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
dataDir=/data/zookeeper/data
dataLogDir=/data/zookeeper/logs
```

**ä¸ºä»€ä¹ˆè¦åˆ†å¼€å­˜å‚¨ï¼Ÿ**
```
æ•°æ®å¿«ç…§ï¼šè¯»å–é¢‘ç¹ï¼Œä½†å†™å…¥ä¸é¢‘ç¹
äº‹åŠ¡æ—¥å¿—ï¼šå†™å…¥éå¸¸é¢‘ç¹ï¼Œè¯»å–è¾ƒå°‘

åˆ†å¼€å­˜å‚¨çš„å¥½å¤„ï¼š
â”œâ”€â”€ æ•°æ®ç›®å½•ï¼šå¯ä»¥ä½¿ç”¨æ™®é€šç¡¬ç›˜
â””â”€â”€ æ—¥å¿—ç›®å½•ï¼šä½¿ç”¨SSDæå‡å†™å…¥æ€§èƒ½
```

### 3.2 ç½‘ç»œè¿æ¥é…ç½®


#### ğŸ”¸ clientPort - å®¢æˆ·ç«¯è¿æ¥ç«¯å£

```properties
# ZooKeeperç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£
clientPort=2181
```

**é€šä¿—ç†è§£**ï¼š
- å°±åƒç»™ZooKeeperå¼€äº†ä¸€æ‰‡"é—¨"ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿™æ‰‡é—¨è¿›æ¥
- Kafkaå°±æ˜¯é€šè¿‡è¿™ä¸ªç«¯å£è¿æ¥åˆ°ZooKeeperçš„
- **2181æ˜¯é»˜è®¤ç«¯å£**ï¼Œå°±åƒHTTPçš„80ç«¯å£ä¸€æ ·

**ğŸ”§ ç«¯å£é€‰æ‹©å»ºè®®**ï¼š
```
å¼€å‘ç¯å¢ƒï¼š2181ï¼ˆé»˜è®¤å³å¯ï¼‰
ç”Ÿäº§ç¯å¢ƒï¼š2181æˆ–è‡ªå®šä¹‰ç«¯å£
é›†ç¾¤ç¯å¢ƒï¼šæ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨ç›¸åŒç«¯å£

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tulpn | grep 2181
```

#### ğŸ”¸ maxClientCnxns - æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°

```properties
# å•ä¸ªå®¢æˆ·ç«¯IPæœ€å¤šå¯ä»¥å»ºç«‹çš„è¿æ¥æ•°
maxClientCnxns=300
```

**å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š
```
å‡è®¾ä½ æœ‰ä¸€ä¸ªIPä¸º192.168.1.100çš„Kafkaé›†ç¾¤ï¼š
- å¦‚æœè®¾ç½®maxClientCnxns=10
- é‚£ä¹ˆè¿™ä¸ªIPæœ€å¤šåªèƒ½å»ºç«‹10ä¸ªè¿æ¥åˆ°ZooKeeper
- è¶…è¿‡10ä¸ªè¿æ¥ä¼šè¢«æ‹’ç»

å»ºè®®è®¾ç½®ï¼š
å°å‹ç¯å¢ƒï¼š60-100
ä¸­å‹ç¯å¢ƒï¼š200-300  
å¤§å‹ç¯å¢ƒï¼š500-1000
```

### 3.3 é›†ç¾¤åŒæ­¥é…ç½®


#### ğŸ”¸ tickTime - åŸºæœ¬æ—¶é—´å•å…ƒ

```properties
# ZooKeeperçš„åŸºæœ¬æ—¶é—´å•å…ƒï¼ˆæ¯«ç§’ï¼‰
tickTime=2000
```

**ç®€å•ç†è§£**ï¼š
- ZooKeeperçš„"å¿ƒè·³èŠ‚æ‹"ï¼Œå°±åƒäººçš„è„‰æ
- å…¶ä»–å¾ˆå¤šè¶…æ—¶è®¾ç½®éƒ½åŸºäºè¿™ä¸ªæ—¶é—´
- **2000æ¯«ç§’ = 2ç§’**æ˜¯ä¸€ä¸ªåˆç†çš„é»˜è®¤å€¼

#### ğŸ”¸ initLimit - åˆå§‹åŒ–åŒæ­¥æ—¶é™

```properties
# é›†ç¾¤åˆå§‹åŒ–æ—¶ï¼Œä»èŠ‚ç‚¹åŒæ­¥åˆ°ä¸»èŠ‚ç‚¹çš„æ—¶é™
initLimit=10
```

**é€šä¿—è§£é‡Š**ï¼š
```
å®é™…è¶…æ—¶æ—¶é—´ = initLimit Ã— tickTime
10 Ã— 2000æ¯«ç§’ = 20ç§’

æ„æ€æ˜¯ï¼šæ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ï¼Œå¿…é¡»åœ¨20ç§’å†…å®Œæˆåˆå§‹åŒ–
å¦‚æœ20ç§’å†…æ²¡å®Œæˆï¼Œå°±è®¤ä¸ºè¿™ä¸ªèŠ‚ç‚¹æœ‰é—®é¢˜
```

#### ğŸ”¸ syncLimit - è¿è¡Œæ—¶åŒæ­¥æ—¶é™

```properties
# é›†ç¾¤è¿è¡Œæ—¶ï¼Œä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹ä¿æŒåŒæ­¥çš„æ—¶é™
syncLimit=5
```

**å®é™…å«ä¹‰**ï¼š
```
å®é™…è¶…æ—¶æ—¶é—´ = syncLimit Ã— tickTime  
5 Ã— 2000æ¯«ç§’ = 10ç§’

æ„æ€æ˜¯ï¼šè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœä»èŠ‚ç‚¹è¶…è¿‡10ç§’æ²¡æœ‰å“åº”ä¸»èŠ‚ç‚¹
å°±è®¤ä¸ºè¿™ä¸ªä»èŠ‚ç‚¹å·²ç»"æ‰çº¿"äº†
```

### 3.4 é›†ç¾¤èŠ‚ç‚¹é…ç½®


#### ğŸ”¸ server.X - é›†ç¾¤èŠ‚ç‚¹å®šä¹‰

```properties
# é›†ç¾¤èŠ‚ç‚¹é…ç½®æ ¼å¼ï¼š
# server.èŠ‚ç‚¹ID=ä¸»æœºå:åŒæ­¥ç«¯å£:é€‰ä¸¾ç«¯å£

# ä¸‰èŠ‚ç‚¹é›†ç¾¤ç¤ºä¾‹
server.1=zk1.example.com:2888:3888
server.2=zk2.example.com:2888:3888  
server.3=zk3.example.com:2888:3888
```

**ç«¯å£ä½œç”¨è¯¦è§£**ï¼š
```
2888ç«¯å£ï¼šé›†ç¾¤å†…éƒ¨æ•°æ®åŒæ­¥ä½¿ç”¨
3888ç«¯å£ï¼šLeaderé€‰ä¸¾æ—¶ä½¿ç”¨

å®Œæ•´çš„é€šä¿¡å›¾ï¼š
ZK1 â†â”€2888â”€â†’ ZK2 â†â”€2888â”€â†’ ZK3
 â”‚    3888     â”‚    3888     â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              é€‰ä¸¾é€šä¿¡
```

**ğŸ”§ å®é™…é…ç½®ç¤ºä¾‹**ï¼š
```properties
# æœ¬åœ°æµ‹è¯•é›†ç¾¤ï¼ˆä¸€å°æœºå™¨å¤šå®ä¾‹ï¼‰
server.1=localhost:2888:3888
server.2=localhost:2889:3889
server.3=localhost:2890:3890

# ç”Ÿäº§ç¯å¢ƒé›†ç¾¤ï¼ˆå¤šå°æœºå™¨ï¼‰
server.1=kafka-zk-01:2888:3888
server.2=kafka-zk-02:2888:3888
server.3=kafka-zk-03:2888:3888
```

---

## 4. ğŸš€ é›†ç¾¤é…ç½®å®æˆ˜


### 4.1 ä¸‰èŠ‚ç‚¹é›†ç¾¤å®Œæ•´é…ç½®


**èŠ‚ç‚¹1é…ç½®æ–‡ä»¶ï¼ˆzk1ï¼‰**ï¼š
```properties
# === åŸºç¡€é…ç½® ===
dataDir=/data/zookeeper/data
dataLogDir=/data/zookeeper/logs
clientPort=2181

# === é›†ç¾¤é…ç½® ===
server.1=zk1.internal:2888:3888
server.2=zk2.internal:2888:3888
server.3=zk3.internal:2888:3888

# === æ€§èƒ½é…ç½® ===
tickTime=2000
initLimit=10
syncLimit=5
maxClientCnxns=300

# === èŠ‚ç‚¹æ ‡è¯† ===
# éœ€è¦åœ¨dataDirç›®å½•ä¸‹åˆ›å»ºmyidæ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š1
```

**èŠ‚ç‚¹èº«ä»½æ ‡è¯†è®¾ç½®**ï¼š
```bash
# åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„dataDirç›®å½•ä¸‹åˆ›å»ºmyidæ–‡ä»¶
echo "1" > /data/zookeeper/data/myid  # èŠ‚ç‚¹1
echo "2" > /data/zookeeper/data/myid  # èŠ‚ç‚¹2  
echo "3" > /data/zookeeper/data/myid  # èŠ‚ç‚¹3
```

### 4.2 é›†ç¾¤é…ç½®éªŒè¯


**ğŸ”¸ å¯åŠ¨é¡ºåºä¸éªŒè¯**
```bash
# 1. ä¾æ¬¡å¯åŠ¨å„èŠ‚ç‚¹ï¼ˆå»ºè®®å…ˆå¯åŠ¨è¿‡åŠæ•°èŠ‚ç‚¹ï¼‰
./zookeeper-server-start.sh config/zookeeper.properties

# 2. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
echo "stat" | nc localhost 2181

# 3. éªŒè¯é›†ç¾¤è§’è‰²
echo "ruok" | nc zk1.internal 2181  # åº”è¯¥è¿”å›"imok"
echo "isro" | nc zk2.internal 2181  # æ£€æŸ¥æ˜¯å¦åªè¯»
```

**ğŸ”¸ é›†ç¾¤å¥åº·æ£€æŸ¥**
```bash
# æ£€æŸ¥å“ªä¸ªæ˜¯Leader
for server in zk1 zk2 zk3; do
    echo "=== $server ==="
    echo "stat" | nc $server 2181 | grep Mode
done

# æœŸæœ›è¾“å‡ºç±»ä¼¼ï¼š
# === zk1 ===
# Mode: follower
# === zk2 === 
# Mode: leader
# === zk3 ===
# Mode: follower
```

---

## 5. âš¡ æ€§èƒ½è°ƒä¼˜é…ç½®


### 5.1 æ•°æ®æ¸…ç†é…ç½®


#### ğŸ”¸ autopurge.snapRetainCount - å¿«ç…§ä¿ç•™æ•°é‡

```properties
# ä¿ç•™å¤šå°‘ä¸ªæ•°æ®å¿«ç…§æ–‡ä»¶
autopurge.snapRetainCount=5
```

**é€šä¿—ç†è§£**ï¼š
- ZooKeeperä¼šå®šæœŸåˆ›å»ºæ•°æ®"å¿«ç…§"ï¼ˆå°±åƒç»™ç³»ç»Ÿæ‹ç…§ï¼‰
- å¿«ç…§å¤ªå¤šä¼šå ç”¨ç£ç›˜ç©ºé—´
- ä¿ç•™**3-10ä¸ª**å¿«ç…§æ˜¯æ¯”è¾ƒåˆç†çš„èŒƒå›´

#### ğŸ”¸ autopurge.purgeInterval - æ¸…ç†é—´éš”æ—¶é—´

```properties
# è‡ªåŠ¨æ¸…ç†é—´éš”ï¼Œå•ä½ï¼šå°æ—¶ï¼ˆ0è¡¨ç¤ºç¦ç”¨è‡ªåŠ¨æ¸…ç†ï¼‰
autopurge.purgeInterval=24
```

**æ¸…ç†ç­–ç•¥ç¤ºä¾‹**ï¼š
```
autopurge.purgeInterval=24  # æ¯24å°æ—¶æ¸…ç†ä¸€æ¬¡
autopurge.snapRetainCount=5 # ä¿ç•™æœ€æ–°çš„5ä¸ªå¿«ç…§

æ¸…ç†è¿‡ç¨‹ï¼š
ä¿ç•™ï¼šsnapshot.100000005
ä¿ç•™ï¼šsnapshot.100000004  
ä¿ç•™ï¼šsnapshot.100000003
ä¿ç•™ï¼šsnapshot.100000002
ä¿ç•™ï¼šsnapshot.100000001
åˆ é™¤ï¼šsnapshot.100000000  â† è¶…è¿‡5ä¸ªçš„æ—§å¿«ç…§è¢«åˆ é™¤
```

### 5.2 å†…å­˜ä¸æ€§èƒ½é…ç½®


**ğŸ”¸ JVMå†…å­˜é…ç½®**
```bash
# åœ¨å¯åŠ¨è„šæœ¬ä¸­è®¾ç½®JVMå‚æ•°
export KAFKA_HEAP_OPTS="-Xmx1G -Xms1G"

# å¯¹äºç”Ÿäº§ç¯å¢ƒçš„å»ºè®®ï¼š
# å°å‹ç¯å¢ƒï¼š1-2GB
# ä¸­å‹ç¯å¢ƒï¼š2-4GB  
# å¤§å‹ç¯å¢ƒï¼š4-8GB
```

**ğŸ”¸ ç½‘ç»œæ€§èƒ½é…ç½®**
```properties
# å®¢æˆ·ç«¯è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
minSessionTimeout=4000
maxSessionTimeout=40000

# ç½‘ç»œå»¶è¿Ÿè¾ƒé«˜çš„ç¯å¢ƒå¯ä»¥é€‚å½“å¢åŠ 
tickTime=3000
initLimit=15
syncLimit=8
```

---

## 6. ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤é…ç½®


### 6.1 å››å­—æ¯å‘½ä»¤é…ç½®


#### ğŸ”¸ 4lw.commands.whitelist - å‘½ä»¤ç™½åå•

```properties
# å…è®¸ä½¿ç”¨çš„å››å­—æ¯ç›‘æ§å‘½ä»¤
4lw.commands.whitelist=stat,ruok,conf,isro
```

**å¸¸ç”¨å››å­—æ¯å‘½ä»¤è¯´æ˜**ï¼š

| å‘½ä»¤ | ä½œç”¨ | è¿”å›ç¤ºä¾‹ |
|------|------|----------|
| **ruok** | æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸ | `imok` |
| **stat** | æ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€ | è¿æ¥æ•°ã€æ¨¡å¼ç­‰ |
| **conf** | æ˜¾ç¤ºé…ç½®ä¿¡æ¯ | é…ç½®å‚æ•°åˆ—è¡¨ |
| **isro** | æ£€æŸ¥æ˜¯å¦åªè¯»æ¨¡å¼ | `rw`æˆ–`ro` |

**ğŸ”§ å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# æ£€æŸ¥ZooKeeperæ˜¯å¦æ­£å¸¸è¿è¡Œ
echo "ruok" | nc localhost 2181
# è¾“å‡ºï¼šimok

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€ä¿¡æ¯  
echo "stat" | nc localhost 2181
# è¾“å‡ºï¼šåŒ…å«è¿æ¥æ•°ã€æ¨¡å¼ã€èŠ‚ç‚¹ä¿¡æ¯ç­‰
```

### 6.2 ç®¡ç†æ¥å£é…ç½®


#### ğŸ”¸ admin.enableServer - ç®¡ç†æœåŠ¡å™¨å¯ç”¨

```properties
# å¯ç”¨HTTPç®¡ç†æ¥å£
admin.enableServer=true
admin.serverPort=8080
```

**ç®¡ç†æ¥å£ç”¨é€”**ï¼š
```
é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttp://zookeeper-host:8080/commands

å¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼š
â”œâ”€â”€ æŸ¥çœ‹é…ç½®ï¼š/commands/config
â”œâ”€â”€ æŸ¥çœ‹çŠ¶æ€ï¼š/commands/stat  
â”œâ”€â”€ æŸ¥çœ‹è¿æ¥ï¼š/commands/cons
â””â”€â”€ ç›‘æ§æŒ‡æ ‡ï¼š/commands/mntr
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**ï¼š
```properties
# ç”Ÿäº§ç¯å¢ƒå»ºè®®ç»‘å®šå†…ç½‘IP
admin.serverAddress=192.168.1.100
admin.serverPort=8080

# æˆ–è€…é€šè¿‡é˜²ç«å¢™é™åˆ¶è®¿é—®
# iptables -A INPUT -p tcp --dport 8080 -s 192.168.1.0/24 -j ACCEPT
```

---

## 7. â— å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ


### 7.1 å¸¸è§é…ç½®é”™è¯¯


**ğŸ”¸ è·¯å¾„æƒé™é—®é¢˜**
```bash
# é”™è¯¯ç°è±¡ï¼šZooKeeperå¯åŠ¨å¤±è´¥
# åŸå› ï¼šæ•°æ®ç›®å½•æƒé™ä¸è¶³

# è§£å†³æ–¹æ¡ˆï¼š
sudo chown -R kafka:kafka /data/zookeeper
sudo chmod -R 755 /data/zookeeper
```

**ğŸ”¸ myidæ–‡ä»¶ç¼ºå¤±**
```bash
# é”™è¯¯ç°è±¡ï¼šé›†ç¾¤èŠ‚ç‚¹æ— æ³•è¯†åˆ«èº«ä»½
# åŸå› ï¼šdataDirä¸‹æ²¡æœ‰myidæ–‡ä»¶

# è§£å†³æ–¹æ¡ˆï¼š
echo "1" > /data/zookeeper/data/myid
# æ³¨æ„ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„myidå¿…é¡»å”¯ä¸€ä¸”ä¸server.Xå¯¹åº”
```

**ğŸ”¸ ç½‘ç»œç«¯å£å†²çª**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep -E "2181|2888|3888"

# å¦‚æœç«¯å£è¢«å ç”¨ï¼Œä¿®æ”¹é…ç½®ï¼š
clientPort=2182  # æ”¹ä¸ºå…¶ä»–ç«¯å£
server.1=host:2889:3889  # åŒæ­¥ç«¯å£ä¹Ÿè¦ä¿®æ”¹
```

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ”¸ ç¡¬ä»¶é…ç½®å»ºè®®**
```
CPUï¼š4æ ¸å¿ƒä»¥ä¸Šï¼ˆZooKeeperæ˜¯CPUå¯†é›†å‹ï¼‰
å†…å­˜ï¼š8GBä»¥ä¸Šï¼ˆJVMå †å†…å­˜å»ºè®®4GBï¼‰
å­˜å‚¨ï¼šSSDä¼˜å…ˆï¼ˆäº‹åŠ¡æ—¥å¿—ç›®å½•å¿…é¡»é«˜æ€§èƒ½ï¼‰
ç½‘ç»œï¼šåƒå…†ç½‘å¡ï¼Œä½å»¶è¿Ÿç½‘ç»œç¯å¢ƒ
```

**ğŸ”¸ ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿**
```properties
# === æ•°æ®å­˜å‚¨ï¼ˆé«˜æ€§èƒ½ï¼‰ ===
dataDir=/data/zookeeper/data
dataLogDir=/ssd/zookeeper/logs    # ä½¿ç”¨SSDå­˜å‚¨æ—¥å¿—

# === ç½‘ç»œé…ç½®ï¼ˆé«˜å¹¶å‘ï¼‰ ===
clientPort=2181
maxClientCnxns=1000

# === é›†ç¾¤é…ç½®ï¼ˆé«˜å¯ç”¨ï¼‰ ===
tickTime=2000
initLimit=20    # ç½‘ç»œè¾ƒæ…¢æ—¶å¢åŠ 
syncLimit=10
server.1=zk-prod-01:2888:3888
server.2=zk-prod-02:2888:3888
server.3=zk-prod-03:2888:3888

# === è‡ªåŠ¨ç»´æŠ¤ ===
autopurge.snapRetainCount=10
autopurge.purgeInterval=12  # æ¯12å°æ—¶æ¸…ç†

# === ç›‘æ§é…ç½® ===
4lw.commands.whitelist=*
admin.enableServer=true
admin.serverPort=8080
admin.serverAddress=0.0.0.0
```

### 7.3 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ”¸ å¸¸è§æ•…éšœè¯Šæ–­**
```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status zookeeper

# 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/zookeeper/zookeeper.log

# 3. æ£€æŸ¥é›†ç¾¤è¿æ¥
echo "stat" | nc localhost 2181

# 4. éªŒè¯é…ç½®æ–‡ä»¶
./zookeeper-server-start.sh config/zookeeper.properties --print-config
```

**ğŸ”¸ é›†ç¾¤è„‘è£‚å¤„ç†**
```
è„‘è£‚ç°è±¡ï¼šé›†ç¾¤ä¸­å‡ºç°å¤šä¸ªLeader

é¢„é˜²æªæ–½ï¼š
1ï¸âƒ£ ç¡®ä¿é›†ç¾¤èŠ‚ç‚¹æ•°ä¸ºå¥‡æ•°ï¼ˆ3ã€5ã€7ï¼‰
2ï¸âƒ£ ç½‘ç»œç¨³å®šï¼Œé¿å…é¢‘ç¹æ–­è¿
3ï¸âƒ£ åˆç†è®¾ç½®è¶…æ—¶å‚æ•°

æ¢å¤æ­¥éª¤ï¼š
1ï¸âƒ£ åœæ­¢æ‰€æœ‰ZooKeeperèŠ‚ç‚¹
2ï¸âƒ£ æ¸…ç†æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ç›®å½•
3ï¸âƒ£ é‡æ–°åˆå§‹åŒ–é›†ç¾¤
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒé…ç½®


**ğŸ”¸ åŸºç¡€é…ç½®ä¸‰è¦ç´ **
```properties
dataDir=/data/zookeeper/data      # æ•°æ®å­˜å‚¨ä½ç½®
clientPort=2181                   # å®¢æˆ·ç«¯è¿æ¥ç«¯å£  
maxClientCnxns=300               # è¿æ¥æ•°é™åˆ¶
```

**ğŸ”¸ é›†ç¾¤é…ç½®å…³é”®ç‚¹**
```properties
server.1=host1:2888:3888         # èŠ‚ç‚¹å®šä¹‰
tickTime=2000                    # åŸºç¡€æ—¶é—´å•å…ƒ
initLimit=10                     # åˆå§‹åŒ–è¶…æ—¶
syncLimit=5                      # åŒæ­¥è¶…æ—¶
```

**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–é‡ç‚¹**
```properties
autopurge.snapRetainCount=5      # å¿«ç…§ä¿ç•™æ•°
autopurge.purgeInterval=24       # æ¸…ç†é—´éš”
dataLogDir=/ssd/zookeeper/logs   # æ—¥å¿—åˆ†ç¦»
```

### 8.2 æœ€ä½³å®è·µæ€»ç»“


**ğŸ¯ é…ç½®åŸåˆ™**
- **å¥‡æ•°èŠ‚ç‚¹**ï¼šé›†ç¾¤å¿…é¡»æ˜¯3ã€5ã€7ç­‰å¥‡æ•°ä¸ªèŠ‚ç‚¹
- **èµ„æºåˆ†ç¦»**ï¼šæ•°æ®å’Œæ—¥å¿—åˆ†å¼€å­˜å‚¨åœ¨ä¸åŒç£ç›˜
- **æƒé™æ§åˆ¶**ï¼šä¸¥æ ¼è®¾ç½®æ–‡ä»¶å’Œç›®å½•æƒé™
- **ç›‘æ§å®Œå¤‡**ï¼šå¯ç”¨ç®¡ç†æ¥å£å’Œå››å­—æ¯å‘½ä»¤

**âš¡ æ€§èƒ½è¦ç‚¹**
- **ç¡¬ä»¶é€‰æ‹©**ï¼šSSDå­˜å‚¨äº‹åŠ¡æ—¥å¿—ï¼Œå……è¶³å†…å­˜
- **ç½‘ç»œä¼˜åŒ–**ï¼šä½å»¶è¿Ÿç½‘ç»œç¯å¢ƒï¼Œåˆç†è¶…æ—¶è®¾ç½®
- **å®šæœŸç»´æŠ¤**ï¼šè‡ªåŠ¨æ¸…ç†æ—§æ•°æ®ï¼Œç›‘æ§ç£ç›˜ç©ºé—´

**ğŸ”’ å®‰å…¨å»ºè®®**
- **ç½‘ç»œéš”ç¦»**ï¼šZooKeeperéƒ¨ç½²åœ¨å†…ç½‘
- **è®¿é—®æ§åˆ¶**ï¼šé™åˆ¶å®¢æˆ·ç«¯è¿æ¥æ•°å’ŒIP
- **ç›‘æ§å‘Šè­¦**ï¼šå®æ—¶ç›‘æ§é›†ç¾¤çŠ¶æ€

**æ ¸å¿ƒè®°ä½**ï¼š
- ZooKeeperæ˜¯Kafkaçš„åè°ƒç®¡å®¶ï¼Œé…ç½®æ­£ç¡®æ˜¯å…³é”®
- é›†ç¾¤é…ç½®è¦å¥‡æ•°èŠ‚ç‚¹ï¼Œç½‘ç»œç¨³å®šæ˜¯åŸºç¡€
- æ€§èƒ½ä¼˜åŒ–é‡ç‚¹åœ¨å­˜å‚¨åˆ†ç¦»å’Œèµ„æºå……è¶³
- ç›‘æ§ç»´æŠ¤ä¸å¯å°‘ï¼Œæ•…éšœæ’æŸ¥æœ‰ç« æ³•