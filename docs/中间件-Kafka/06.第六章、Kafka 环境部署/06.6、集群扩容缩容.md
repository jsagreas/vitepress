---
title: 6ã€é›†ç¾¤æ‰©å®¹ç¼©å®¹
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤æ‰©å®¹ç¼©å®¹æ¦‚è¿°](#1-é›†ç¾¤æ‰©å®¹ç¼©å®¹æ¦‚è¿°)
2. [èŠ‚ç‚¹æ·»åŠ æµç¨‹](#2-èŠ‚ç‚¹æ·»åŠ æµç¨‹)
3. [æ•°æ®è¿ç§»ç­–ç•¥](#3-æ•°æ®è¿ç§»ç­–ç•¥)
4. [å‰¯æœ¬é‡åˆ†é…](#4-å‰¯æœ¬é‡åˆ†é…)
5. [åˆ†åŒºè¿ç§»](#5-åˆ†åŒºè¿ç§»)
6. [æµé‡åˆ‡æ¢](#6-æµé‡åˆ‡æ¢)
7. [èŠ‚ç‚¹ä¸‹çº¿](#7-èŠ‚ç‚¹ä¸‹çº¿)
8. [å¹³æ»‘æ‰©å®¹](#8-å¹³æ»‘æ‰©å®¹)
9. [å®¹é‡è§„åˆ’](#9-å®¹é‡è§„åˆ’)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ é›†ç¾¤æ‰©å®¹ç¼©å®¹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯é›†ç¾¤æ‰©å®¹ç¼©å®¹


**ğŸ”¸ ç®€å•ç†è§£**
```
æ‰©å®¹ï¼ˆScale Outï¼‰= å¢åŠ æ›´å¤šæœºå™¨
å°±åƒé¤å…ç”Ÿæ„å¥½äº†ï¼Œå¢åŠ æ›´å¤šæ¡Œå­å’ŒæœåŠ¡å‘˜

ç¼©å®¹ï¼ˆScale Inï¼‰= å‡å°‘æœºå™¨
å°±åƒé¤å…ç”Ÿæ„æ·¡äº†ï¼Œå‡å°‘æ¡Œå­å’ŒæœåŠ¡å‘˜èŠ‚çº¦æˆæœ¬

Kafkaé›†ç¾¤æ‰©ç¼©å®¹ = åŠ¨æ€è°ƒæ•´é›†ç¾¤ä¸­çš„BrokerèŠ‚ç‚¹æ•°é‡
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ‰©å®¹ç¼©å®¹


**ğŸ’¡ æ‰©å®¹çš„å¸¸è§åœºæ™¯**
```
ä¸šåŠ¡å¢é•¿ï¼š
- æ¶ˆæ¯é‡æš´å¢ï¼Œç°æœ‰é›†ç¾¤å¤„ç†ä¸è¿‡æ¥
- ç”¨æˆ·é‡æ¿€å¢ï¼Œéœ€è¦æ›´å¤šå¤„ç†èƒ½åŠ›
- æ–°ä¸šåŠ¡ä¸Šçº¿ï¼Œéœ€è¦æ›´å¤šå­˜å‚¨ç©ºé—´

æ€§èƒ½ç“¶é¢ˆï¼š
- CPUä½¿ç”¨ç‡é•¿æœŸè¿‡é«˜ï¼ˆ>80%ï¼‰
- å†…å­˜ä¸è¶³ï¼Œé¢‘ç¹GC
- ç£ç›˜IOè¾¾åˆ°ç“¶é¢ˆ
- ç½‘ç»œå¸¦å®½ä¸å¤Ÿç”¨

å¯ç”¨æ€§æå‡ï¼š
- å¢åŠ æ›´å¤šå‰¯æœ¬æé«˜å¯é æ€§
- æä¾›æ›´å¥½çš„å®¹é”™èƒ½åŠ›
```

**ğŸ”¸ ç¼©å®¹çš„å¸¸è§åœºæ™¯**
```
æˆæœ¬ä¼˜åŒ–ï¼š
- ä¸šåŠ¡é‡ä¸‹é™ï¼Œèµ„æºåˆ©ç”¨ç‡ä½
- äº‘æœåŠ¡è´¹ç”¨è¿‡é«˜ï¼Œéœ€è¦èŠ‚çº¦æˆæœ¬
- æµ‹è¯•ç¯å¢ƒèµ„æºå›æ”¶

æ¶æ„è°ƒæ•´ï¼š
- åˆå¹¶å¤šä¸ªå°é›†ç¾¤
- è¿ç§»åˆ°æ›´é«˜é…ç½®çš„æœºå™¨
- æ·˜æ±°è€æ—§ç¡¬ä»¶
```

### 1.3 æ‰©å®¹ç¼©å®¹çš„æŒ‘æˆ˜


**âš ï¸ ä¸»è¦éš¾ç‚¹**
```
æ•°æ®ä¸€è‡´æ€§ï¼š
- å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Ÿ
- å‰¯æœ¬å¦‚ä½•æ­£ç¡®è¿ç§»ï¼Ÿ
- å…ƒæ•°æ®å¦‚ä½•åŒæ­¥ï¼Ÿ

æœåŠ¡å¯ç”¨æ€§ï¼š
- å¦‚ä½•åšåˆ°æ— æ„ŸçŸ¥æ‰©ç¼©å®¹ï¼Ÿ
- ä¸šåŠ¡æµé‡å¦‚ä½•å¹³æ»‘åˆ‡æ¢ï¼Ÿ
- å‡ºé—®é¢˜äº†å¦‚ä½•å¿«é€Ÿå›æ»šï¼Ÿ

æ€§èƒ½å½±å“ï¼š
- æ•°æ®è¿ç§»ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ
- å¦‚ä½•æ§åˆ¶è¿ç§»é€Ÿåº¦ï¼Ÿ
- ä»€ä¹ˆæ—¶å€™è¿ç§»æœ€åˆé€‚ï¼Ÿ
```

---

## 2. ğŸ”§ èŠ‚ç‚¹æ·»åŠ æµç¨‹


### 2.1 æ–°èŠ‚ç‚¹å‡†å¤‡å·¥ä½œ


**ğŸ“‹ ç¡¬ä»¶ç¯å¢ƒæ£€æŸ¥**
```bash
# 1. æ£€æŸ¥ç³»ç»Ÿèµ„æº
free -h                 # å†…å­˜å¤Ÿä¸å¤Ÿ
df -h                   # ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
lscpu                   # CPUæ ¸æ•°å’Œé¢‘ç‡
iostat -x 1 5          # ç£ç›˜IOæ€§èƒ½

# 2. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping ç°æœ‰brokerèŠ‚ç‚¹IP
telnet zookeeperèŠ‚ç‚¹ 2181
```

**ğŸ”¸ è½¯ä»¶ç¯å¢ƒé…ç½®**
```bash
# 1. å®‰è£…Javaç¯å¢ƒ
java -version           # ç¡®ä¿ç‰ˆæœ¬ä¸€è‡´

# 2. å®‰è£…Kafka
# ç¡®ä¿ç‰ˆæœ¬ä¸ç°æœ‰é›†ç¾¤å®Œå…¨ä¸€è‡´
kafka_2.13-2.8.0.tgz

# 3. é…ç½®ç³»ç»Ÿå‚æ•°
echo 'vm.swappiness = 1' >> /etc/sysctl.conf
echo '* soft nofile 65536' >> /etc/security/limits.conf
```

### 2.2 Brokeré…ç½®æ–‡ä»¶


**ğŸ’» server.propertieså…³é”®é…ç½®**
```properties
# æ–°èŠ‚ç‚¹çš„å”¯ä¸€IDï¼ˆä¸èƒ½ä¸ç°æœ‰èŠ‚ç‚¹é‡å¤ï¼‰
broker.id=3

# é›†ç¾¤åœ°å€ï¼ˆä¸ç°æœ‰èŠ‚ç‚¹ä¿æŒä¸€è‡´ï¼‰
listeners=PLAINTEXT://æ–°èŠ‚ç‚¹IP:9092
zookeeper.connect=zk1:2181,zk2:2181,zk3:2181

# æ—¥å¿—ç›®å½•
log.dirs=/kafka-logs

# å‰¯æœ¬ç›¸å…³é…ç½®ï¼ˆä¸ç°æœ‰é›†ç¾¤ä¿æŒä¸€è‡´ï¼‰
default.replication.factor=3
min.insync.replicas=2
```

> ğŸ’¡ **é‡è¦æé†’**ï¼šæ–°èŠ‚ç‚¹çš„`broker.id`å¿…é¡»åœ¨é›†ç¾¤ä¸­å”¯ä¸€ï¼Œå»ºè®®æŒ‰é¡ºåºé€’å¢

### 2.3 å¯åŠ¨æ–°èŠ‚ç‚¹


**ğŸš€ å¯åŠ¨æ­¥éª¤**
```bash
# 1. å¯åŠ¨æ–°çš„Broker
bin/kafka-server-start.sh -daemon config/server.properties

# 2. æ£€æŸ¥å¯åŠ¨çŠ¶æ€
tail -f logs/server.log

# 3. éªŒè¯èŠ‚ç‚¹æ˜¯å¦åŠ å…¥é›†ç¾¤
bin/kafka-broker-api-versions.sh --bootstrap-server æ–°èŠ‚ç‚¹IP:9092
```

**âœ… éªŒè¯æ–°èŠ‚ç‚¹çŠ¶æ€**
```bash
# æŸ¥çœ‹é›†ç¾¤ä¸­çš„æ‰€æœ‰Broker
bin/kafka-topics.sh --bootstrap-server localhost:9092 \
    --describe --topic __consumer_offsets
    
# åº”è¯¥èƒ½çœ‹åˆ°æ–°åŠ å…¥çš„broker.id
```

### 2.4 èŠ‚ç‚¹æ·»åŠ æ³¨æ„äº‹é¡¹


**âš ï¸ å¸¸è§é—®é¢˜åŠè§£å†³**
```
é—®é¢˜1ï¼šæ–°èŠ‚ç‚¹å¯åŠ¨å¤±è´¥
åŸå› ï¼šbroker.idé‡å¤
è§£å†³ï¼šæ£€æŸ¥å¹¶ä¿®æ”¹ä¸ºå”¯ä¸€ID

é—®é¢˜2ï¼šæ— æ³•è¿æ¥ZooKeeper
åŸå› ï¼šç½‘ç»œä¸é€šæˆ–ZKåœ°å€é”™è¯¯
è§£å†³ï¼šæ£€æŸ¥ç½‘ç»œå’Œzookeeper.connecté…ç½®

é—®é¢˜3ï¼šæ—¥å¿—ç›®å½•æƒé™é—®é¢˜
åŸå› ï¼škafkaç”¨æˆ·æ²¡æœ‰å†™æƒé™
è§£å†³ï¼šchown -R kafka:kafka /kafka-logs
```

---

## 3. ğŸ“Š æ•°æ®è¿ç§»ç­–ç•¥


### 3.1 æ•°æ®è¿ç§»çš„æœ¬è´¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ•°æ®è¿ç§»**
```
ä¼ ç»Ÿç†è§£ï¼šæŠŠæ•°æ®ä»Aæœºå™¨æ¬åˆ°Bæœºå™¨
Kafkaçš„è¿ç§»ï¼šè°ƒæ•´åˆ†åŒºå‰¯æœ¬çš„åˆ†å¸ƒä½ç½®

ä¸¾ä¸ªä¾‹å­ï¼š
åŸæ¥ï¼šTopicæœ‰3ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒº3ä¸ªå‰¯æœ¬ï¼Œåˆ†å¸ƒåœ¨3ä¸ªèŠ‚ç‚¹ä¸Š
ç°åœ¨ï¼šæ–°å¢1ä¸ªèŠ‚ç‚¹ï¼Œå¸Œæœ›æŠŠéƒ¨åˆ†å‰¯æœ¬è¿ç§»åˆ°æ–°èŠ‚ç‚¹ä¸Š
ç›®çš„ï¼šè®©æ–°èŠ‚ç‚¹ä¹Ÿæ‰¿æ‹…å­˜å‚¨å’Œå¤„ç†ä»»åŠ¡
```

### 3.2 è¿ç§»ç­–ç•¥é€‰æ‹©


**ğŸ“‹ ä¸‰ç§ä¸»è¦ç­–ç•¥**

| ç­–ç•¥ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|------------|---------|---------|
| ğŸ”„ **å…¨é‡è¿ç§»** | `æ–°é›†ç¾¤æ­å»º` | `åˆ†å¸ƒå‡åŒ€ï¼Œæ€§èƒ½æœ€ä¼˜` | `è¿ç§»æ—¶é—´é•¿ï¼Œå½±å“è¾ƒå¤§` |
| ğŸ¯ **å¢é‡è¿ç§»** | `åœ¨çº¿æ‰©å®¹` | `å½±å“å°ï¼Œå¯æ§åˆ¶é€Ÿåº¦` | `åˆ†å¸ƒå¯èƒ½ä¸å¤Ÿå‡åŒ€` |
| âš¡ **æ··åˆç­–ç•¥** | `å¤§è§„æ¨¡é›†ç¾¤` | `å…¼é¡¾æ•ˆç‡å’Œç¨³å®šæ€§` | `æ“ä½œå¤æ‚` |

**ğŸ’¡ ç­–ç•¥é€‰æ‹©åŸåˆ™**
```bash
# ä¸šåŠ¡å‹åŠ›å°çš„æ—¶å€™ â†’ é€‰æ‹©å…¨é‡è¿ç§»
if [ ä¸šåŠ¡ä½å³°æœŸ ] && [ æ•°æ®é‡ä¸å¤§ ]; then
    echo "å»ºè®®å…¨é‡è¿ç§»ï¼Œä¸€æ¬¡æ€§è°ƒæ•´åˆ°æœ€ä¼˜åˆ†å¸ƒ"
fi

# 7x24å°æ—¶æœåŠ¡ â†’ é€‰æ‹©å¢é‡è¿ç§»
if [ ä¸èƒ½åœæœº ] && [ æ€§èƒ½è¦æ±‚é«˜ ]; then
    echo "å»ºè®®å¢é‡è¿ç§»ï¼Œåˆ†æ‰¹æ¬¡æ…¢æ…¢è°ƒæ•´"
fi
```

### 3.3 è¿ç§»å‰çš„å‡†å¤‡å·¥ä½œ


**ğŸ” å®¹é‡è¯„ä¼°**
```bash
# 1. è¯„ä¼°å½“å‰æ•°æ®é‡
bin/kafka-log-dirs.sh --bootstrap-server localhost:9092 \
    --describe --json | jq '.brokers[].logDirs[].partitions[].size'

# 2. è¯„ä¼°ç½‘ç»œå¸¦å®½éœ€æ±‚
# æ•°æ®é‡ Ã· æœŸæœ›è¿ç§»æ—¶é—´ = éœ€è¦çš„å¸¦å®½

# 3. è¯„ä¼°ç£ç›˜IOèƒ½åŠ›
iostat -x 1 10  # è§‚å¯Ÿç£ç›˜ä½¿ç”¨ç‡
```

**ğŸ“ è¿ç§»è®¡åˆ’åˆ¶å®š**
```
ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©è¿ç§»å¯¹è±¡
- ä¼˜å…ˆé€‰æ‹©æ•°æ®é‡å°çš„Topic
- é€‰æ‹©ä¸šåŠ¡å½±å“å°çš„åˆ†åŒº
- é¿å¼€ä¸šåŠ¡é«˜å³°æœŸ

ç¬¬äºŒæ­¥ï¼šåˆ¶å®šæ—¶é—´çª—å£
- ç¡®å®šå¼€å§‹æ—¶é—´ï¼ˆå»ºè®®å‡Œæ™¨ä½å³°æœŸï¼‰
- é¢„ä¼°å®Œæˆæ—¶é—´
- å‡†å¤‡å›æ»šæ–¹æ¡ˆ

ç¬¬ä¸‰æ­¥ï¼šé£é™©è¯„ä¼°
- å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶
- å‡†å¤‡ç›‘æ§è„šæœ¬
- è®¾ç½®å‘Šè­¦é˜ˆå€¼
```

---

## 4. ğŸ”„ å‰¯æœ¬é‡åˆ†é…


### 4.1 å‰¯æœ¬é‡åˆ†é…åŸç†


**ğŸ”¸ ä»€ä¹ˆæ˜¯å‰¯æœ¬é‡åˆ†é…**
```
ç®€å•ç†è§£ï¼šé‡æ–°å®‰æ’å‰¯æœ¬ä½åœ¨å“ªäº›èŠ‚ç‚¹ä¸Š

åŸæ¥çš„åˆ†å¸ƒï¼š
Topic: user-events (3åˆ†åŒºï¼Œ3å‰¯æœ¬)
åˆ†åŒº0å‰¯æœ¬ï¼š[1, 2, 3]  # åœ¨broker 1,2,3ä¸Š
åˆ†åŒº1å‰¯æœ¬ï¼š[2, 3, 1]  # åœ¨broker 2,3,1ä¸Š
åˆ†åŒº2å‰¯æœ¬ï¼š[3, 1, 2]  # åœ¨broker 3,1,2ä¸Š

æ–°å¢broker 4åï¼Œé‡åˆ†é…ç›®æ ‡ï¼š
åˆ†åŒº0å‰¯æœ¬ï¼š[1, 2, 4]  # æŠŠbroker3æ›¿æ¢ä¸ºbroker4
åˆ†åŒº1å‰¯æœ¬ï¼š[2, 3, 4]  # æŠŠbroker1æ›¿æ¢ä¸ºbroker4
åˆ†åŒº2å‰¯æœ¬ï¼š[3, 4, 1]  # æŠŠbroker2æ›¿æ¢ä¸ºbroker4
```

### 4.2 ç”Ÿæˆé‡åˆ†é…æ–¹æ¡ˆ


**ğŸ“‹ ä½¿ç”¨kafka-reassign-partitions.shå·¥å…·**
```bash
# 1. åˆ›å»ºtopics-to-move.jsonæ–‡ä»¶
cat > topics-to-move.json << EOF
{
    "topics": [
        {"topic": "user-events"},
        {"topic": "order-events"}
    ],
    "version": 1
}
EOF

# 2. ç”Ÿæˆé‡åˆ†é…æ–¹æ¡ˆ
bin/kafka-reassign-partitions.sh \
    --bootstrap-server localhost:9092 \
    --topics-to-move-json-file topics-to-move.json \
    --broker-list "1,2,3,4" \
    --generate
```

**ğŸ“Š æ–¹æ¡ˆè¾“å‡ºè§£è¯»**
```json
// å½“å‰åˆ†é…æ–¹æ¡ˆï¼ˆCurrent partition replica assignmentï¼‰
{
    "version": 1,
    "partitions": [
        {"topic":"user-events","partition":0,"replicas":[1,2,3]},
        {"topic":"user-events","partition":1,"replicas":[2,3,1]}
    ]
}

// å»ºè®®åˆ†é…æ–¹æ¡ˆï¼ˆProposed partition reassignment configurationï¼‰
{
    "version": 1,
    "partitions": [
        {"topic":"user-events","partition":0,"replicas":[1,2,4]},
        {"topic":"user-events","partition":1,"replicas":[2,4,1]}
    ]
}
```

> ğŸ’¡ **ç†è§£å»ºè®®**ï¼šKafkaä¼šè‡ªåŠ¨è®¡ç®—æœ€å‡è¡¡çš„åˆ†å¸ƒæ–¹æ¡ˆï¼Œè®©æ¯ä¸ªbrokeræ‰¿æ‹…çš„å‰¯æœ¬æ•°é‡å°½å¯èƒ½å¹³å‡

### 4.3 æ‰§è¡Œå‰¯æœ¬é‡åˆ†é…


**ğŸš€ æ‰§è¡Œé‡åˆ†é…**
```bash
# 1. ä¿å­˜å»ºè®®æ–¹æ¡ˆåˆ°æ–‡ä»¶
cat > reassignment.json << EOF
{
    "version": 1,
    "partitions": [
        {"topic":"user-events","partition":0,"replicas":[1,2,4]},
        {"topic":"user-events","partition":1,"replicas":[2,4,1]}
    ]
}
EOF

# 2. æ‰§è¡Œé‡åˆ†é…
bin/kafka-reassign-partitions.sh \
    --bootstrap-server localhost:9092 \
    --reassignment-json-file reassignment.json \
    --execute
```

**ğŸ“ˆ ç›‘æ§é‡åˆ†é…è¿›åº¦**
```bash
# æŸ¥çœ‹é‡åˆ†é…çŠ¶æ€
bin/kafka-reassign-partitions.sh \
    --bootstrap-server localhost:9092 \
    --reassignment-json-file reassignment.json \
    --verify

# è¾“å‡ºç¤ºä¾‹ï¼š
# Status of partition reassignment:
# Reassignment of partition user-events-0 is complete.
# Reassignment of partition user-events-1 is still in progress.
```

### 4.4 é‡åˆ†é…è¿‡ç¨‹è¯¦è§£


**ğŸ”„ é‡åˆ†é…å†…éƒ¨æµç¨‹**
```
é˜¶æ®µ1ï¼šå‡†å¤‡é˜¶æ®µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ›å»ºæ–°å‰¯æœ¬      â”‚ â† åœ¨ç›®æ ‡brokerä¸Šåˆ›å»ºåˆ†åŒºç›®å½•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼€å§‹æ•°æ®åŒæ­¥    â”‚ â† ä»Leaderå¤åˆ¶æ‰€æœ‰æ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿½èµ¶è¿›åº¦       â”‚ â† åŒæ­¥æœ€æ–°çš„æ¶ˆæ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2ï¼šåˆ‡æ¢é˜¶æ®µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ å…¥ISRåˆ—è¡¨     â”‚ â† æ–°å‰¯æœ¬åŠ å…¥åŒæ­¥å‰¯æœ¬åˆ—è¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç§»é™¤è€å‰¯æœ¬      â”‚ â† ä»ISRä¸­ç§»é™¤è¦ä¸‹çº¿çš„å‰¯æœ¬
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ é™¤è€æ•°æ®      â”‚ â† æ¸…ç†è€å‰¯æœ¬çš„æ•°æ®æ–‡ä»¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš ï¸ é‡åˆ†é…æ³¨æ„äº‹é¡¹**
```
æ€§èƒ½å½±å“ï¼š
- æ•°æ®å¤åˆ¶ä¼šå ç”¨ç½‘ç»œå¸¦å®½
- ç£ç›˜IOä¼šæ˜æ˜¾å¢åŠ 
- å»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œ

å®‰å…¨æ€§ï¼š
- é‡åˆ†é…è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢æ•°æ®
- ä½†ä¼šä¸´æ—¶å¢åŠ å‰¯æœ¬æ•°é‡
- ç¡®ä¿ç£ç›˜ç©ºé—´å……è¶³

å¯æ¢å¤æ€§ï¼š
- è¿‡ç¨‹å¯ä»¥æš‚åœå’Œæ¢å¤
- å¼‚å¸¸ä¸­æ–­ä¼šè‡ªåŠ¨æ¢å¤
- å¯ä»¥éšæ—¶æŸ¥çœ‹è¿›åº¦
```

---

## 5. ğŸ“¦ åˆ†åŒºè¿ç§»


### 5.1 åˆ†åŒºè¿ç§»åŸºç¡€


**ğŸ”¸ åˆ†åŒºè¿ç§» vs å‰¯æœ¬é‡åˆ†é…**
```
å‰¯æœ¬é‡åˆ†é…ï¼šè°ƒæ•´å‰¯æœ¬åœ¨å“ªäº›brokerä¸Š
åˆ†åŒºè¿ç§»ï¼šè°ƒæ•´åˆ†åŒºçš„Leaderåœ¨å“ªä¸ªbrokerä¸Š

ä¸¾ä¸ªä¾‹å­ï¼š
åˆ†åŒº0çš„å‰¯æœ¬åˆ†å¸ƒï¼š[1, 2, 3] ï¼ˆbroker 1,2,3éƒ½æœ‰å‰¯æœ¬ï¼‰
å½“å‰Leaderï¼šbroker 1
è¿ç§»åLeaderï¼šbroker 2 ï¼ˆä½†å‰¯æœ¬åˆ†å¸ƒä¸å˜ï¼‰

ä¸ºä»€ä¹ˆè¦è¿ç§»Leaderï¼Ÿ
- å¹³è¡¡å„brokerçš„å¤„ç†å‹åŠ›
- é¿å…çƒ­ç‚¹é—®é¢˜
- ä¼˜åŒ–ç½‘ç»œä¼ è¾“è·¯å¾„
```

### 5.2 æ‰‹åŠ¨åˆ†åŒºLeaderè¿ç§»


**ğŸ¯ åå¥½å‰¯æœ¬é€‰ä¸¾**
```bash
# 1. æŸ¥çœ‹å½“å‰Leaderåˆ†å¸ƒ
bin/kafka-topics.sh --bootstrap-server localhost:9092 \
    --describe --topic user-events

# è¾“å‡ºç¤ºä¾‹ï¼š
# Topic: user-events  PartitionCount: 3  ReplicationFactor: 3
# Partition: 0  Leader: 2  Replicas: 1,2,3  Isr: 1,2,3
# Partition: 1  Leader: 3  Replicas: 2,3,1  Isr: 2,3,1
# Partition: 2  Leader: 1  Replicas: 3,1,2  Isr: 3,1,2

# 2. è§¦å‘åå¥½å‰¯æœ¬é€‰ä¸¾
bin/kafka-preferred-replica-election.sh \
    --bootstrap-server localhost:9092 \
    --path-to-json-file preferred-replicas.json
```

**ğŸ“„ preferred-replicas.jsoné…ç½®**
```json
{
    "partitions": [
        {"topic": "user-events", "partition": 0},
        {"topic": "user-events", "partition": 1},
        {"topic": "user-events", "partition": 2}
    ]
}
```

> ğŸ’¡ **åå¥½å‰¯æœ¬è§£é‡Š**ï¼šKafkaä¼šå°è¯•è®©æ¯ä¸ªåˆ†åŒºçš„ç¬¬ä¸€ä¸ªå‰¯æœ¬æˆä¸ºLeaderï¼Œè¿™æ ·å¯ä»¥ä¿æŒè´Ÿè½½å‡è¡¡

### 5.3 è‡ªåŠ¨Leaderå¹³è¡¡


**âš–ï¸ å¼€å¯è‡ªåŠ¨å¹³è¡¡**
```properties
# server.propertiesä¸­é…ç½®
auto.leader.rebalance.enable=true
leader.imbalance.check.interval.seconds=300
leader.imbalance.per.broker.percentage=10
```

**ğŸ”¸ å‚æ•°å«ä¹‰è§£é‡Š**
```
auto.leader.rebalance.enable=true
å«ä¹‰ï¼šå¼€å¯è‡ªåŠ¨Leaderå¹³è¡¡åŠŸèƒ½

leader.imbalance.check.interval.seconds=300
å«ä¹‰ï¼šæ¯300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦å¹³è¡¡

leader.imbalance.per.broker.percentage=10
å«ä¹‰ï¼šå¦‚æœæŸä¸ªbrokerçš„Leaderä¸å¹³è¡¡ç‡è¶…è¿‡10%ï¼Œå°±è§¦å‘å¹³è¡¡
è®¡ç®—ï¼š(å®é™…Leaderæ•° - æœŸæœ›Leaderæ•°) / æœŸæœ›Leaderæ•° > 10%
```

### 5.4 åˆ†åŒºè¿ç§»ç›‘æ§


**ğŸ“Š ç›‘æ§Leaderåˆ†å¸ƒ**
```bash
#!/bin/bash
# leader-distribution.sh - ç›‘æ§è„šæœ¬

echo "=== Leaderåˆ†å¸ƒæƒ…å†µ ==="
bin/kafka-topics.sh --bootstrap-server localhost:9092 --list | while read topic; do
    echo "Topic: $topic"
    bin/kafka-topics.sh --bootstrap-server localhost:9092 \
        --describe --topic $topic | \
        awk '/Partition:/ {print "  Partition " $2 " Leader: " $4}'
done
```

**ğŸ“ˆ æ€§èƒ½å½±å“è¯„ä¼°**
```bash
# ç›‘æ§å„brokerçš„å¤„ç†è´Ÿè½½
bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
    --describe --group your-consumer-group

# è§‚å¯Ÿç½‘ç»œæµé‡åˆ†å¸ƒ
iftop -i eth0

# ç›‘æ§ç£ç›˜IOåˆ†å¸ƒ
iostat -x 1 5
```

---

## 6. ğŸ”€ æµé‡åˆ‡æ¢


### 6.1 æµé‡åˆ‡æ¢ç­–ç•¥


**ğŸ¯ æ¸è¿›å¼åˆ‡æ¢**
```
ä¼ ç»Ÿåˆ‡æ¢ï¼šä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æµé‡åˆ‡åˆ°æ–°èŠ‚ç‚¹
é—®é¢˜ï¼šé£é™©å¤§ï¼Œå‡ºé—®é¢˜å½±å“å…¨éƒ¨ä¸šåŠ¡

æ¸è¿›å¼åˆ‡æ¢ï¼šåˆ†æ‰¹æ¬¡ã€åˆ†æ¯”ä¾‹æ…¢æ…¢åˆ‡æ¢æµé‡
ä¼˜åŠ¿ï¼šé£é™©å¯æ§ï¼Œå‡ºé—®é¢˜å½±å“èŒƒå›´å°

åˆ‡æ¢æ­¥éª¤ï¼š
ç¬¬1æ­¥ï¼šåˆ‡æ¢10%æµé‡ï¼Œè§‚å¯Ÿ1å°æ—¶
ç¬¬2æ­¥ï¼šåˆ‡æ¢30%æµé‡ï¼Œè§‚å¯Ÿ30åˆ†é’Ÿ  
ç¬¬3æ­¥ï¼šåˆ‡æ¢50%æµé‡ï¼Œè§‚å¯Ÿ30åˆ†é’Ÿ
ç¬¬4æ­¥ï¼šåˆ‡æ¢80%æµé‡ï¼Œè§‚å¯Ÿ15åˆ†é’Ÿ
ç¬¬5æ­¥ï¼šåˆ‡æ¢100%æµé‡
```

### 6.2 Produceræµé‡åˆ‡æ¢


**ğŸ“ å®¢æˆ·ç«¯é…ç½®è°ƒæ•´**
```java
// åŸæ¥çš„é…ç½®ï¼šåªè¿æ¥è€èŠ‚ç‚¹
Properties props = new Properties();
props.put("bootstrap.servers", "broker1:9092,broker2:9092,broker3:9092");

// æ‰©å®¹åçš„é…ç½®ï¼šåŒ…å«æ–°èŠ‚ç‚¹
Properties props = new Properties();
props.put("bootstrap.servers", 
    "broker1:9092,broker2:9092,broker3:9092,broker4:9092");
```

**ğŸ”„ å¹³æ»‘åˆ‡æ¢æ–¹æ¡ˆ**
```bash
# æ–¹æ¡ˆ1ï¼šé…ç½®ä¸­å¿ƒåŠ¨æ€æ›´æ–°
# é€šè¿‡é…ç½®ä¸­å¿ƒï¼ˆå¦‚Apolloã€Nacosï¼‰åŠ¨æ€æ¨é€æ–°çš„brokeråˆ—è¡¨

# æ–¹æ¡ˆ2ï¼šDNSè½®è¯¢
# é…ç½®DNSè½®è¯¢ï¼Œé€æ­¥åŠ å…¥æ–°èŠ‚ç‚¹çš„IP

# æ–¹æ¡ˆ3ï¼šè´Ÿè½½å‡è¡¡å™¨
# åœ¨è´Ÿè½½å‡è¡¡å™¨å±‚é¢æ§åˆ¶æµé‡åˆ†é…æ¯”ä¾‹
```

### 6.3 Consumeræµé‡åˆ‡æ¢


**ğŸ‘¥ Consumer Groupé‡å¹³è¡¡**
```java
// Consumerä¼šè‡ªåŠ¨å‘ç°æ–°çš„åˆ†åŒºå’Œå‰¯æœ¬
// ä½†éœ€è¦æ³¨æ„é‡å¹³è¡¡å¯¹æ€§èƒ½çš„å½±å“

// å‡å°‘é‡å¹³è¡¡å½±å“çš„é…ç½®
props.put("session.timeout.ms", 30000);      // å¢åŠ sessionè¶…æ—¶
props.put("heartbeat.interval.ms", 10000);   // å¢åŠ å¿ƒè·³é—´éš”
props.put("max.poll.interval.ms", 600000);   // å¢åŠ pollé—´éš”
```

**âš¡ åˆ‡æ¢è¿‡ç¨‹ç›‘æ§**
```bash
# ç›‘æ§Consumer GroupçŠ¶æ€
bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
    --describe --group your-group --verbose

# è§‚å¯Ÿé‡å¹³è¡¡é¢‘ç‡
tail -f logs/server.log | grep "rebalance"

# ç›‘æ§æ¶ˆè´¹å»¶è¿Ÿ
bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
    --describe --group your-group
```

### 6.4 æµé‡åˆ‡æ¢éªŒè¯


**âœ… åˆ‡æ¢æ•ˆæœéªŒè¯**
```bash
# 1. éªŒè¯æ–°èŠ‚ç‚¹å¤„ç†èƒ½åŠ›
bin/kafka-console-producer.sh \
    --bootstrap-server broker4:9092 \
    --topic test-topic

# 2. éªŒè¯æ•°æ®ä¸€è‡´æ€§
bin/kafka-console-consumer.sh \
    --bootstrap-server broker4:9092 \
    --topic test-topic --from-beginning

# 3. éªŒè¯æ€§èƒ½æŒ‡æ ‡
# è§‚å¯ŸTPSã€å»¶è¿Ÿã€é”™è¯¯ç‡ç­‰å…³é”®æŒ‡æ ‡
```

---

## 7. ğŸšª èŠ‚ç‚¹ä¸‹çº¿


### 7.1 èŠ‚ç‚¹ä¸‹çº¿å‡†å¤‡


**ğŸ” ä¸‹çº¿å‰æ£€æŸ¥**
```bash
# 1. æ£€æŸ¥èŠ‚ç‚¹ä¸Šçš„å‰¯æœ¬åˆ†å¸ƒ
bin/kafka-topics.sh --bootstrap-server localhost:9092 \
    --describe | grep "Replicas:.*3"  # å‡è®¾broker 3è¦ä¸‹çº¿

# 2. æ£€æŸ¥æ˜¯å¦æœ‰é‡è¦çš„Leader
bin/kafka-topics.sh --bootstrap-server localhost:9092 \
    --describe | grep "Leader: 3"

# 3. æ£€æŸ¥æ¶ˆè´¹è€…è¿æ¥æƒ…å†µ
netstat -an | grep :9092 | wc -l  # ç»Ÿè®¡è¿æ¥æ•°
```

**âš ï¸ ä¸‹çº¿é£é™©è¯„ä¼°**
```
é«˜é£é™©æƒ…å†µï¼š
- èŠ‚ç‚¹ä¸Šæœ‰å¾ˆå¤šåˆ†åŒºçš„å”¯ä¸€å‰¯æœ¬
- èŠ‚ç‚¹æ‰¿æ‹…å¤§é‡Leaderè§’è‰²
- å‰¯æœ¬æ•°é‡å·²ç»å¾ˆå°‘ï¼ˆå¦‚åªæœ‰2ä¸ªå‰¯æœ¬ï¼‰

ä½é£é™©æƒ…å†µï¼š
- èŠ‚ç‚¹ä¸Šçš„å‰¯æœ¬åœ¨å…¶ä»–èŠ‚ç‚¹éƒ½æœ‰å¤‡ä»½
- Leaderåˆ†å¸ƒæ¯”è¾ƒå‡åŒ€
- å‰¯æœ¬æ•°é‡å……è¶³ï¼ˆ3ä¸ªæˆ–ä»¥ä¸Šï¼‰
```

### 7.2 ä¼˜é›…ä¸‹çº¿æµç¨‹


**ğŸ“‹ æ ‡å‡†ä¸‹çº¿æ­¥éª¤**
```bash
# ç¬¬1æ­¥ï¼šè¿ç§»å‰¯æœ¬
# ä½¿ç”¨å‰¯æœ¬é‡åˆ†é…å·¥å…·ï¼ŒæŠŠè¦ä¸‹çº¿èŠ‚ç‚¹çš„å‰¯æœ¬è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹

# ç¬¬2æ­¥ï¼šç­‰å¾…è¿ç§»å®Œæˆ
bin/kafka-reassign-partitions.sh \
    --bootstrap-server localhost:9092 \
    --reassignment-json-file reassignment.json \
    --verify

# ç¬¬3æ­¥ï¼šæ£€æŸ¥æ— å‰¯æœ¬åå…³é—­æœåŠ¡
bin/kafka-server-stop.sh

# ç¬¬4æ­¥ï¼šæ¸…ç†ZooKeeperä¸­çš„æ³¨å†Œä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
# ZooKeeperä¼šè‡ªåŠ¨æ¸…ç†ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸…ç†
```

**ğŸ”„ åˆ†é˜¶æ®µä¸‹çº¿**
```
é˜¶æ®µ1ï¼šåœæ­¢æ¥æ”¶æ–°çš„Leaderé€‰ä¸¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾ç½®brokerä¸º   â”‚
â”‚ åªè¯»æ¨¡å¼        â”‚  â† ä¸å†æ¥æ”¶æ–°çš„Leaderè§’è‰²
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2ï¼šè¿ç§»Leaderè§’è‰²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§¦å‘åå¥½å‰¯æœ¬    â”‚
â”‚ é€‰ä¸¾           â”‚  â† æŠŠLeaderè½¬ç§»åˆ°å…¶ä»–èŠ‚ç‚¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ3ï¼šè¿ç§»å‰¯æœ¬æ•°æ®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰¯æœ¬é‡åˆ†é…      â”‚
â”‚ æ•°æ®è¿ç§»        â”‚  â† æŠŠå‰¯æœ¬è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ4ï¼šå®‰å…¨ä¸‹çº¿
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…³é—­æœåŠ¡        â”‚
â”‚ æ¸…ç†èµ„æº        â”‚  â† æ­£å¼ä¸‹çº¿èŠ‚ç‚¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 å¼ºåˆ¶ä¸‹çº¿å¤„ç†


**ğŸš¨ ç´§æ€¥ä¸‹çº¿åœºæ™¯**
```
ç¡¬ä»¶æ•…éšœï¼š
- æœåŠ¡å™¨å®•æœºï¼Œæ— æ³•æ­£å¸¸å…³é—­
- ç£ç›˜æŸåï¼Œæ•°æ®æ— æ³•è®¿é—®
- ç½‘ç»œä¸­æ–­ï¼ŒèŠ‚ç‚¹å¤±è”

å¤„ç†åŸåˆ™ï¼š
- ä¼˜å…ˆä¿è¯é›†ç¾¤æ•´ä½“å¯ç”¨æ€§
- å¿«é€Ÿæ¢å¤æœåŠ¡ï¼Œåç»­è¡¥å……å‰¯æœ¬
- åŠæ—¶é€šçŸ¥ä¸šåŠ¡æ–¹å¯èƒ½çš„å½±å“
```

**âš¡ å¿«é€Ÿæ¢å¤æ­¥éª¤**
```bash
# 1. ä»ZooKeeperä¸­ç§»é™¤æ•…éšœèŠ‚ç‚¹ä¿¡æ¯
# æ³¨æ„ï¼šè¿™ä¸ªæ“ä½œæœ‰é£é™©ï¼Œç¡®ä¿èŠ‚ç‚¹çœŸçš„æ— æ³•æ¢å¤

# 2. è°ƒæ•´å—å½±å“Topicçš„min.insync.replicas
bin/kafka-configs.sh --bootstrap-server localhost:9092 \
    --entity-type topics --entity-name affected-topic \
    --alter --add-config min.insync.replicas=1

# 3. ä¸ºå—å½±å“çš„åˆ†åŒºå¢åŠ æ–°å‰¯æœ¬
# é€šè¿‡å‰¯æœ¬é‡åˆ†é…æ¢å¤å‰¯æœ¬æ•°é‡

# 4. ç›‘æ§é›†ç¾¤çŠ¶æ€
bin/kafka-topics.sh --bootstrap-server localhost:9092 \
    --describe --under-replicated-partitions
```

---

## 8. ğŸ¯ å¹³æ»‘æ‰©å®¹


### 8.1 å¹³æ»‘æ‰©å®¹çš„æ ¸å¿ƒæ€æƒ³


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¹³æ»‘æ‰©å®¹**
```
ä¼ ç»Ÿæ‰©å®¹ï¼šåœæœº â†’ åŠ èŠ‚ç‚¹ â†’ è¿ç§»æ•°æ® â†’ å¯åŠ¨æœåŠ¡
é—®é¢˜ï¼šä¸šåŠ¡ä¸­æ–­ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ

å¹³æ»‘æ‰©å®¹ï¼šåœ¨çº¿ â†’ åŠ èŠ‚ç‚¹ â†’ é€æ­¥è¿ç§» â†’ æ— æ„ŸçŸ¥åˆ‡æ¢
ä¼˜åŠ¿ï¼šä¸šåŠ¡ä¸ä¸­æ–­ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
```

**ğŸ’¡ å¹³æ»‘æ‰©å®¹çš„å…³é”®è¦ç´ **
```
1. é›¶åœæœºï¼šæ•´ä¸ªè¿‡ç¨‹ä¸šåŠ¡ä¸ä¸­æ–­
2. å¯å›æ»šï¼šå‡ºé—®é¢˜èƒ½å¿«é€Ÿæ¢å¤
3. å¯ç›‘æ§ï¼šå…¨ç¨‹æœ‰æŒ‡æ ‡è§‚å¯Ÿ
4. å¯æ§åˆ¶ï¼šèƒ½æ§åˆ¶è¿ç§»é€Ÿåº¦å’Œå½±å“èŒƒå›´
```

### 8.2 æ‰©å®¹æ—¶æœºé€‰æ‹©


**â° æœ€ä½³æ‰©å®¹æ—¶æœº**
```bash
# 1. ä¸šåŠ¡ä½å³°æœŸåˆ¤æ–­
hour=$(date +%H)
if [ $hour -ge 2 ] && [ $hour -le 6 ]; then
    echo "å½“å‰æ˜¯å‡Œæ™¨ä½å³°æœŸï¼Œé€‚åˆæ‰©å®¹"
else
    echo "å½“å‰æ˜¯ä¸šåŠ¡é«˜å³°æœŸï¼Œå»ºè®®ç­‰å¾…"
fi

# 2. ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥
cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | sed 's/%us,//')
if [ $(echo "$cpu_usage < 50" | bc) -eq 1 ]; then
    echo "CPUä½¿ç”¨ç‡${cpu_usage}%ï¼Œç³»ç»Ÿè´Ÿè½½è¾ƒä½ï¼Œé€‚åˆæ‰©å®¹"
fi

# 3. ç½‘ç»œå¸¦å®½æ£€æŸ¥
# ç¡®ä¿æœ‰è¶³å¤Ÿå¸¦å®½è¿›è¡Œæ•°æ®è¿ç§»
```

### 8.3 æ‰©å®¹ç›‘æ§ä½“ç³»


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```bash
#!/bin/bash
# smooth-scaling-monitor.sh

echo "=== Kafkaæ‰©å®¹ç›‘æ§é¢æ¿ ==="

# 1. é›†ç¾¤æ•´ä½“å¥åº·åº¦
echo "ã€é›†ç¾¤çŠ¶æ€ã€‘"
bin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092 | \
    grep "id:" | wc -l | xargs echo "åœ¨çº¿Brokeræ•°é‡ï¼š"

# 2. æ•°æ®è¿ç§»è¿›åº¦
echo "ã€è¿ç§»è¿›åº¦ã€‘"
bin/kafka-reassign-partitions.sh \
    --bootstrap-server localhost:9092 \
    --reassignment-json-file reassignment.json \
    --verify 2>/dev/null | grep "in progress" | wc -l | \
    xargs echo "è¿›è¡Œä¸­çš„è¿ç§»ä»»åŠ¡ï¼š"

# 3. æ€§èƒ½å½±å“ç›‘æ§
echo "ã€æ€§èƒ½æŒ‡æ ‡ã€‘"
iostat -x 1 1 | grep "avg-cpu" -A 1 | tail -1 | \
    awk '{print "CPUä½¿ç”¨ç‡: " $1 "%"}'

# 4. å‰¯æœ¬åŒæ­¥çŠ¶æ€
echo "ã€åŒæ­¥çŠ¶æ€ã€‘"
bin/kafka-topics.sh --bootstrap-server localhost:9092 \
    --describe --under-replicated-partitions | wc -l | \
    xargs echo "æœªåŒæ­¥å‰¯æœ¬æ•°ï¼š"
```

### 8.4 æ‰©å®¹å›æ»šç­–ç•¥


**ğŸ”™ å›æ»šåœºæ™¯**
```
æ€§èƒ½ä¸¥é‡ä¸‹é™ï¼š
- å“åº”æ—¶é—´å¢åŠ >50%
- é”™è¯¯ç‡å¢åŠ >1%
- CPU/å†…å­˜ä½¿ç”¨ç‡>90%

æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼š
- å‘ç°æ•°æ®ä¸¢å¤±
- å‰¯æœ¬åŒæ­¥å¼‚å¸¸
- æ¶ˆè´¹è€…æ— æ³•æ­£å¸¸æ¶ˆè´¹

ä¸šåŠ¡åŠŸèƒ½å¼‚å¸¸ï¼š
- å…³é”®ä¸šåŠ¡æµç¨‹å—å½±å“
- ç”¨æˆ·æŠ•è¯‰å¢åŠ 
- ç›‘æ§å‘Šè­¦é¢‘ç¹
```

**âš¡ å¿«é€Ÿå›æ»šæ–¹æ¡ˆ**
```bash
# 1. æš‚åœæ•°æ®è¿ç§»
# æ‰¾åˆ°reassignmentè¿›ç¨‹å¹¶æš‚åœ

# 2. æ¢å¤åŸæœ‰é…ç½®
cp server.properties.backup server.properties

# 3. é‡å¯å—å½±å“çš„æœåŠ¡
bin/kafka-server-start.sh -daemon config/server.properties

# 4. éªŒè¯æœåŠ¡æ¢å¤
bin/kafka-console-producer.sh --bootstrap-server localhost:9092 \
    --topic test-topic < test-data.txt
```

---

## 9. ğŸ“ˆ å®¹é‡è§„åˆ’


### 9.1 å®¹é‡è§„åˆ’åŸºç¡€


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦å®¹é‡è§„åˆ’**
```
ä¸šåŠ¡å‘å±•é¢„æµ‹ï¼š
- ç”¨æˆ·é‡é¢„è®¡å¢é•¿50%ï¼Œæ¶ˆæ¯é‡ä¼šå¢é•¿å¤šå°‘ï¼Ÿ
- æ–°ä¸šåŠ¡ä¸Šçº¿ï¼Œéœ€è¦å¤šå°‘é¢å¤–èµ„æºï¼Ÿ
- åŒ11è¿™ç§å¤§ä¿ƒï¼Œæµé‡ä¼šç¿»å‡ å€ï¼Ÿ

æˆæœ¬æ§åˆ¶ï¼š
- èµ„æºä¸å¤Ÿå½±å“ä¸šåŠ¡ï¼Œèµ„æºè¿‡å¤šæµªè´¹é’±
- ä»€ä¹ˆæ—¶å€™æ‰©å®¹æœ€ç»æµï¼Ÿ
- å¦‚ä½•å¹³è¡¡æ€§èƒ½å’Œæˆæœ¬ï¼Ÿ

é£é™©æ§åˆ¶ï¼š
- èµ„æºä¸è¶³ä¼šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨
- æå‰è§„åˆ’é¿å…ç´§æ€¥æ‰©å®¹
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„å®¹é”™èƒ½åŠ›
```

### 9.2 å®¹é‡è¯„ä¼°æ–¹æ³•


**ğŸ“Š æ•°æ®é‡è¯„ä¼°**
```bash
# 1. å†å²æ•°æ®åˆ†æ
# è®¡ç®—æ¯æ—¥/æ¯å°æ—¶çš„æ¶ˆæ¯é‡å¢é•¿è¶‹åŠ¿
bin/kafka-log-dirs.sh --bootstrap-server localhost:9092 \
    --describe --json > disk-usage-$(date +%Y%m%d).json

# 2. ä¸šåŠ¡å³°å€¼åˆ†æ
# åˆ†æå†å²å³°å€¼ï¼Œé¢„æµ‹æœªæ¥å³°å€¼
grep "request-rate" logs/server.log | \
    awk '{print $NF}' | sort -n | tail -10

# 3. å­˜å‚¨éœ€æ±‚è®¡ç®—
# æ¶ˆæ¯é‡ Ã— æ¶ˆæ¯å¤§å° Ã— ä¿ç•™å¤©æ•° Ã— å‰¯æœ¬æ•° = å­˜å‚¨éœ€æ±‚
```

**ğŸ’» æ€§èƒ½éœ€æ±‚è¯„ä¼°**
```
TPSéœ€æ±‚ï¼š
å½“å‰å³°å€¼TPSï¼š10,000 msg/s
é¢„è®¡å¢é•¿ï¼š50%
ç›®æ ‡TPSï¼š15,000 msg/s
å®‰å…¨ç³»æ•°ï¼š1.5å€
è®¾è®¡TPSï¼š22,500 msg/s

å»¶è¿Ÿéœ€æ±‚ï¼š
P99å»¶è¿Ÿ < 100ms
P95å»¶è¿Ÿ < 50ms
å¹³å‡å»¶è¿Ÿ < 20ms

å¯ç”¨æ€§éœ€æ±‚ï¼š
SLAï¼š99.9%ï¼ˆæ¯æœˆæœ€å¤š43åˆ†é’Ÿæ•…éšœï¼‰
RPOï¼š0ï¼ˆä¸å…è®¸æ•°æ®ä¸¢å¤±ï¼‰
RTOï¼š< 5åˆ†é’Ÿï¼ˆæ•…éšœæ¢å¤æ—¶é—´ï¼‰
```

### 9.3 ç¡¬ä»¶è§„æ ¼è®¡ç®—


**ğŸ–¥ï¸ æœåŠ¡å™¨é…ç½®è§„åˆ’**
```bash
# CPUè§„åˆ’
# ç»éªŒå€¼ï¼š1ä¸ªCPUæ ¸å¿ƒå¯å¤„ç†1000-2000 TPS
target_tps=22500
cpu_cores_needed=$((target_tps / 1500))  # å–ä¸­é—´å€¼1500
echo "å»ºè®®CPUæ ¸å¿ƒæ•°ï¼š${cpu_cores_needed}æ ¸"

# å†…å­˜è§„åˆ’  
# ç»éªŒå€¼ï¼šæ¯1GBå†…å­˜å¯ç¼“å­˜çº¦10GBæ•°æ®
cache_data_gb=100  # æœŸæœ›ç¼“å­˜çš„çƒ­æ•°æ®
memory_needed_gb=$((cache_data_gb / 10))
echo "å»ºè®®å†…å­˜å¤§å°ï¼š${memory_needed_gb}GB"

# ç£ç›˜è§„åˆ’
# æ€»å­˜å‚¨ = æ•°æ®é‡ Ã— ä¿ç•™å¤©æ•° Ã— å‰¯æœ¬æ•° Ã— å®‰å…¨ç³»æ•°
daily_data_gb=50
retention_days=7
replication_factor=3
safety_factor=2
total_disk_gb=$((daily_data_gb * retention_days * replication_factor * safety_factor))
echo "å»ºè®®ç£ç›˜ç©ºé—´ï¼š${total_disk_gb}GB"
```

### 9.4 é›†ç¾¤è§„æ¨¡è§„åˆ’


**ğŸ—ï¸ èŠ‚ç‚¹æ•°é‡è®¡ç®—**
```
æ–¹æ³•1ï¼šåŸºäºTPSè®¡ç®—
å•èŠ‚ç‚¹å¤„ç†èƒ½åŠ›ï¼š3000 TPS
ç›®æ ‡TPSï¼š22500 TPS
æœ€å°‘èŠ‚ç‚¹æ•°ï¼š22500 Ã· 3000 = 7.5 â‰ˆ 8ä¸ªèŠ‚ç‚¹
è€ƒè™‘å®¹é”™ï¼ˆN+1ï¼‰ï¼š9ä¸ªèŠ‚ç‚¹

æ–¹æ³•2ï¼šåŸºäºå­˜å‚¨è®¡ç®—  
å•èŠ‚ç‚¹å­˜å‚¨ï¼š2TB
æ€»å­˜å‚¨éœ€æ±‚ï¼š10TB
æœ€å°‘èŠ‚ç‚¹æ•°ï¼š10TB Ã· 2TB = 5ä¸ªèŠ‚ç‚¹
è€ƒè™‘å®¹é”™ï¼š6ä¸ªèŠ‚ç‚¹

æ–¹æ³•3ï¼šåŸºäºç½‘ç»œå¸¦å®½è®¡ç®—
å•èŠ‚ç‚¹ç½‘ç»œï¼š1Gbps
æ€»å¸¦å®½éœ€æ±‚ï¼š5Gbps  
æœ€å°‘èŠ‚ç‚¹æ•°ï¼š5ä¸ªèŠ‚ç‚¹

ç»¼åˆè¯„ä¼°ï¼šå–æœ€å¤§å€¼ï¼Œå»ºè®®9ä¸ªèŠ‚ç‚¹
```

**ğŸ“‹ æ‰©å®¹æ—¶é—´è§„åˆ’**
```
é˜¶æ®µ1ï¼ˆå½“å‰-3ä¸ªæœˆï¼‰ï¼š
- ç›‘æ§ç°æœ‰èµ„æºä½¿ç”¨ç‡
- å®Œå–„ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
- å‡†å¤‡æ‰©å®¹æ–¹æ¡ˆå’Œå·¥å…·

é˜¶æ®µ2ï¼ˆ3ä¸ªæœˆå†…ï¼‰ï¼š
- ä¸šåŠ¡é‡è¾¾åˆ°å½“å‰å®¹é‡70%æ—¶å¼€å§‹å‡†å¤‡
- ç¡¬ä»¶é‡‡è´­å’Œç¯å¢ƒå‡†å¤‡
- æ‰©å®¹æ–¹æ¡ˆæµ‹è¯•éªŒè¯

é˜¶æ®µ3ï¼ˆä¸šåŠ¡é‡è¾¾åˆ°80%ï¼‰ï¼š
- æ‰§è¡Œæ‰©å®¹æ“ä½œ
- éªŒè¯æ‰©å®¹æ•ˆæœ
- æ›´æ–°ç›‘æ§å’Œå‘Šè­¦é˜ˆå€¼

é˜¶æ®µ4ï¼ˆåç»­ä¼˜åŒ–ï¼‰ï¼š
- æŒç»­ç›‘æ§å’Œè°ƒä¼˜
- æ€»ç»“ç»éªŒï¼Œå®Œå–„æµç¨‹
- ä¸ºä¸‹æ¬¡æ‰©å®¹åšå‡†å¤‡
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ‰©å®¹æœ¬è´¨ï¼šåŠ¨æ€è°ƒæ•´é›†ç¾¤ä¸­BrokerèŠ‚ç‚¹æ•°é‡ï¼Œæå‡å¤„ç†èƒ½åŠ›
ğŸ”¸ ç¼©å®¹ç›®æ ‡ï¼šåœ¨ä¿è¯æœåŠ¡è´¨é‡çš„å‰æä¸‹ï¼Œä¼˜åŒ–èµ„æºä½¿ç”¨å’Œæˆæœ¬
ğŸ”¸ å¹³æ»‘æ“ä½œï¼šæ•´ä¸ªè¿‡ç¨‹å¯¹ä¸šåŠ¡æ— æ„ŸçŸ¥ï¼Œä¸å½±å“æœåŠ¡å¯ç”¨æ€§
ğŸ”¸ æ•°æ®è¿ç§»ï¼šé€šè¿‡å‰¯æœ¬é‡åˆ†é…ï¼Œè°ƒæ•´æ•°æ®åœ¨èŠ‚ç‚¹é—´çš„åˆ†å¸ƒ
ğŸ”¸ å®¹é‡è§„åˆ’ï¼šæå‰é¢„æµ‹èµ„æºéœ€æ±‚ï¼Œé¿å…è¢«åŠ¨æ‰©å®¹
```

### 10.2 å…³é”®æ“ä½œè¦ç‚¹


**ğŸ”¹ æ‰©å®¹æ“ä½œæ ¸å¿ƒæ­¥éª¤**
```
å‡†å¤‡é˜¶æ®µï¼š
- ç¡¬ä»¶ç¯å¢ƒæ£€æŸ¥å’Œè½¯ä»¶å®‰è£…
- é…ç½®æ–‡ä»¶å‡†å¤‡ï¼ˆæ³¨æ„broker.idå”¯ä¸€æ€§ï¼‰
- ç½‘ç»œè¿é€šæ€§å’Œæƒé™éªŒè¯

æ‰§è¡Œé˜¶æ®µï¼š
- å¯åŠ¨æ–°èŠ‚ç‚¹å¹¶éªŒè¯åŠ å…¥é›†ç¾¤
- ç”Ÿæˆå¹¶æ‰§è¡Œå‰¯æœ¬é‡åˆ†é…æ–¹æ¡ˆ
- ç›‘æ§è¿ç§»è¿›åº¦å’Œç³»ç»Ÿæ€§èƒ½

å®Œæˆé˜¶æ®µï¼š
- éªŒè¯æ•°æ®åˆ†å¸ƒå’ŒæœåŠ¡å¯ç”¨æ€§
- æ›´æ–°å®¢æˆ·ç«¯é…ç½®å’Œç›‘æ§å‘Šè­¦
- è®°å½•æ“ä½œè¿‡ç¨‹å’Œç»éªŒæ€»ç»“
```

**ğŸ”¹ ç¼©å®¹æ“ä½œæ ¸å¿ƒè¦ç‚¹**
```
é£é™©è¯„ä¼°ï¼š
- æ£€æŸ¥è¦ä¸‹çº¿èŠ‚ç‚¹çš„å‰¯æœ¬åˆ†å¸ƒ
- ç¡®ä¿æœ‰è¶³å¤Ÿå‰¯æœ¬ä¿è¯æ•°æ®å®‰å…¨
- è¯„ä¼°å¯¹ä¸šåŠ¡çš„æ½œåœ¨å½±å“

ä¼˜é›…ä¸‹çº¿ï¼š
- å…ˆè¿ç§»Leaderè§’è‰²åˆ°å…¶ä»–èŠ‚ç‚¹
- å†è¿ç§»å‰¯æœ¬æ•°æ®åˆ°å…¶ä»–èŠ‚ç‚¹
- æœ€åå…³é—­æœåŠ¡å¹¶æ¸…ç†èµ„æº

åº”æ€¥å¤„ç†ï¼š
- ç¡¬ä»¶æ•…éšœæ—¶çš„å¿«é€Ÿæ¢å¤æ–¹æ¡ˆ
- è°ƒæ•´ISRå‚æ•°ä¿è¯æœåŠ¡å¯ç”¨æ€§
- åŠæ—¶è¡¥å……å‰¯æœ¬æ•°é‡
```

### 10.3 æœ€ä½³å®è·µå»ºè®®


**âœ… æ‰©å®¹æœ€ä½³å®è·µ**
```
æ—¶æœºé€‰æ‹©ï¼š
- åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œæ‰©å®¹æ“ä½œ
- èµ„æºä½¿ç”¨ç‡è¾¾åˆ°70-80%æ—¶å¼€å§‹å‡†å¤‡
- é¿å…åœ¨å…³é”®ä¸šåŠ¡æ—¶é—´çª—å£æ“ä½œ

æ“ä½œè§„èŒƒï¼š
- åˆ¶å®šè¯¦ç»†çš„æ“ä½œè®¡åˆ’å’Œå›æ»šæ–¹æ¡ˆ
- è®¾ç½®å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- åˆ†æ‰¹æ¬¡ã€å°æ­¥éª¤æ¸è¿›å¼æ“ä½œ

é£é™©æ§åˆ¶ï¼š
- å¤‡ä»½é‡è¦çš„é…ç½®æ–‡ä»¶å’Œå…ƒæ•°æ®
- æå‰æµ‹è¯•æ‰©å®¹æµç¨‹å’Œå·¥å…·
- å‡†å¤‡åº”æ€¥é¢„æ¡ˆå’Œè”ç³»æ–¹å¼
```

**âš ï¸ å¸¸è§é—®é¢˜é¿å…**
```
é…ç½®é”™è¯¯ï¼š
- broker.idé‡å¤å¯¼è‡´å¯åŠ¨å¤±è´¥
- ZooKeeperè¿æ¥é…ç½®é”™è¯¯
- æ—¥å¿—ç›®å½•æƒé™é—®é¢˜

æ“ä½œå¤±è¯¯ï¼š
- æ²¡æœ‰ç­‰å¾…æ•°æ®è¿ç§»å®Œæˆå°±ä¸‹çº¿èŠ‚ç‚¹
- åœ¨ä¸šåŠ¡é«˜å³°æœŸè¿›è¡Œæ‰©å®¹æ“ä½œ
- ç¼ºå°‘ç›‘æ§å¯¼è‡´é—®é¢˜å‘ç°ä¸åŠæ—¶

å®¹é‡è§„åˆ’ï¼š
- æ²¡æœ‰è€ƒè™‘ä¸šåŠ¡å¢é•¿é¢„æµ‹
- ç¡¬ä»¶é…ç½®ä¸åŒ¹é…æ€§èƒ½éœ€æ±‚
- ç¼ºå°‘å®¹é”™å’Œå®‰å…¨ç³»æ•°è€ƒè™‘
```

### 10.4 ç›‘æ§å’Œè¿ç»´è¦ç‚¹


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```
é›†ç¾¤å¥åº·åº¦ï¼š
- åœ¨çº¿Brokeræ•°é‡å’ŒçŠ¶æ€
- å‰¯æœ¬åŒæ­¥çŠ¶æ€ï¼ˆISRï¼‰
- åˆ†åŒºLeaderåˆ†å¸ƒæƒ…å†µ

æ€§èƒ½æŒ‡æ ‡ï¼š
- TPSå’Œå“åº”æ—¶é—´
- CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
- ç½‘ç»œå¸¦å®½ä½¿ç”¨æƒ…å†µ

ä¸šåŠ¡æŒ‡æ ‡ï¼š
- æ¶ˆæ¯ç”Ÿäº§å’Œæ¶ˆè´¹é€Ÿç‡
- Consumer Lagæƒ…å†µ
- é”™è¯¯ç‡å’Œå‘Šè­¦é¢‘ç‡
```

**ğŸ”§ è¿ç»´è‡ªåŠ¨åŒ–å»ºè®®**
```
è„šæœ¬å·¥å…·ï¼š
- æ‰©å®¹æ“ä½œè‡ªåŠ¨åŒ–è„šæœ¬
- ç›‘æ§æ•°æ®æ”¶é›†å’Œåˆ†æå·¥å…·
- æ•…éšœè‡ªåŠ¨æ¢å¤å’Œå‘Šè­¦è„šæœ¬

é…ç½®ç®¡ç†ï¼š
- é…ç½®æ–‡ä»¶ç‰ˆæœ¬åŒ–ç®¡ç†
- ç¯å¢ƒä¸€è‡´æ€§æ£€æŸ¥å·¥å…·
- æ‰¹é‡é…ç½®æ›´æ–°å·¥å…·

å®¹é‡ç®¡ç†ï¼š
- èµ„æºä½¿ç”¨è¶‹åŠ¿åˆ†æ
- è‡ªåŠ¨æ‰©å®¹å†³ç­–æ”¯æŒ
- æˆæœ¬å’Œæ€§èƒ½ä¼˜åŒ–å»ºè®®
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ‰©å®¹è¦ç¨³ä¸è¦æ€¥ï¼Œå‡†å¤‡å……åˆ†å†åŠ¨æ‰‹
- æ•°æ®è¿ç§»åˆ†æ‰¹æ¬¡ï¼Œç›‘æ§å‘Šè­¦å…¨ç¨‹è·Ÿ
- ç¼©å®¹æ›´éœ€å°å¿ƒè°¨ï¼Œå‰¯æœ¬å®‰å…¨æ˜¯å‰æ
- å®¹é‡è§„åˆ’æ—©ç€æ‰‹ï¼Œæœªé›¨ç»¸ç¼ªä¸è¢«åŠ¨