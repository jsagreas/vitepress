---
title: 6ã€SSLä¸TLSåŠ å¯†é—®é¢˜
---
## ğŸ“š ç›®å½•


1. [SSL/TLSåŠ å¯†åŸºç¡€æ¦‚å¿µ](#1-SSL/TLSåŠ å¯†åŸºç¡€æ¦‚å¿µ)
2. [è¯ä¹¦æ–‡ä»¶é…ç½®é—®é¢˜](#2-è¯ä¹¦æ–‡ä»¶é…ç½®é—®é¢˜)
3. [è¯ä¹¦è®¤è¯ç›¸å…³æ•…éšœ](#3-è¯ä¹¦è®¤è¯ç›¸å…³æ•…éšœ)
4. [SSLåè®®å…¼å®¹æ€§é—®é¢˜](#4-SSLåè®®å…¼å®¹æ€§é—®é¢˜)
5. [ç½‘ç»œè¿æ¥å’Œæ¡æ‰‹æ•…éšœ](#5-ç½‘ç»œè¿æ¥å’Œæ¡æ‰‹æ•…éšœ)
6. [æ•…éšœè¯Šæ–­å·¥å…·ä¸æ–¹æ³•](#6-æ•…éšœè¯Šæ–­å·¥å…·ä¸æ–¹æ³•)
7. [æœ€ä½³å®è·µå’Œé¢„é˜²æªæ–½](#7-æœ€ä½³å®è·µå’Œé¢„é˜²æªæ–½)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦äº†è§£KafkaåŸºç¡€æ¦‚å¿µã€ç½‘ç»œåè®®åŸºç¡€ â†’ **å½“å‰å†…å®¹**ï¼šSSL/TLSæ•…éšœæ’æŸ¥ â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ Kafkaå®‰å…¨è®¤è¯æœºåˆ¶

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡45åˆ†é’Ÿ | å®è·µæ“ä½œ30åˆ†é’Ÿ

ğŸ·ï¸ **çŸ¥è¯†æ ‡ç­¾**ï¼š`#Kafkaå®‰å…¨` `#SSLè¯ä¹¦` `#æ•…éšœæ’æŸ¥` `#ç½‘ç»œé€šä¿¡`

---

## 1. ğŸ” SSL/TLSåŠ å¯†åŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯SSL/TLSåŠ å¯†



**ğŸ”¸ é€šä¿—ç†è§£**
```
SSL/TLSå°±åƒç»™ä¿¡ä»¶åŠ ä¸Šä¿é™©ç®±ï¼š
â€¢ æ™®é€šé€šä¿¡ï¼šåƒæ˜ä¿¡ç‰‡ï¼Œå†…å®¹è°éƒ½èƒ½çœ‹åˆ°
â€¢ SSLåŠ å¯†é€šä¿¡ï¼šåƒå¯†ç ç®±ï¼Œåªæœ‰æœ‰é’¥åŒ™çš„äººæ‰èƒ½æ‰“å¼€
â€¢ åœ¨Kafkaä¸­ï¼šä¿æŠ¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“
```

**ğŸ“‹ æ ¸å¿ƒä½œç”¨**
- **æ•°æ®åŠ å¯†**ï¼šé˜²æ­¢ä¼ è¾“è¿‡ç¨‹ä¸­è¢«çªƒå¬
- **èº«ä»½éªŒè¯**ï¼šç¡®è®¤é€šä¿¡åŒæ–¹çš„çœŸå®èº«ä»½  
- **æ•°æ®å®Œæ•´æ€§**ï¼šé˜²æ­¢æ•°æ®åœ¨ä¼ è¾“ä¸­è¢«ç¯¡æ”¹

### 1.2 Kafkaä¸­çš„SSLæ¶æ„



**ğŸ—ï¸ SSLé€šä¿¡æµç¨‹**
```
å®¢æˆ·ç«¯                     Kafka Broker
  |                            |
  |---[1]å‘èµ·SSLè¿æ¥è¯·æ±‚------->|
  |<--[2]è¿”å›æœåŠ¡å™¨è¯ä¹¦---------|
  |---[3]éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§------->|
  |---[4]å‘é€å®¢æˆ·ç«¯è¯ä¹¦------->|
  |<--[5]éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦--------|
  |---[6]åå•†åŠ å¯†å‚æ•°--------->|
  |<--[7]ç¡®è®¤åŠ å¯†é€šé“----------|
  |                            |
  |====== åŠ å¯†æ•°æ®ä¼ è¾“ ======|
```

### 1.3 å…³é”®ç»„ä»¶è¯´æ˜



| **ç»„ä»¶åç§°** | **ä½œç”¨è¯´æ˜** | **ç±»æ¯”ç†è§£** |
|-------------|-------------|-------------|
| **è¯ä¹¦(Certificate)** | æ•°å­—èº«ä»½è¯æ˜æ–‡ä»¶ | åƒèº«ä»½è¯ï¼Œè¯æ˜ä½ æ˜¯è° |
| **ç§é’¥(Private Key)** | è§£å¯†å’Œç­¾åçš„å¯†é’¥ | åƒä¿é™©ç®±é’¥åŒ™ï¼Œåªæœ‰è‡ªå·±æœ‰ |
| **å…¬é’¥(Public Key)** | åŠ å¯†å’ŒéªŒè¯çš„å¯†é’¥ | åƒé—¨ç‰Œå·ï¼Œå¯ä»¥å…¬å¼€ |
| **å¯†é’¥åº“(KeyStore)** | å­˜æ”¾è‡ªå·±è¯ä¹¦çš„ä»“åº“ | åƒè‡ªå·±çš„è¯ä»¶å¤¹ |
| **ä¿¡ä»»åº“(TrustStore)** | å­˜æ”¾ä¿¡ä»»è¯ä¹¦çš„ä»“åº“ | åƒé€šè®¯å½•ï¼Œè®°å½•ä¿¡ä»»çš„äºº |

---

## 2. ğŸ“ è¯ä¹¦æ–‡ä»¶é…ç½®é—®é¢˜



### 2.1 è¯ä¹¦è·¯å¾„é”™è¯¯



**âŒ å¸¸è§é”™è¯¯ç°è±¡**
```bash
# å¯åŠ¨Kafkaæ—¶çš„å…¸å‹é”™è¯¯

java.io.FileNotFoundException: /wrong/path/server.keystore.jks 
(No such file or directory)
```

**ğŸ’¡ è§£å†³æ€è·¯**
```
ç¬¬ä¸€æ­¥ï¼šç¡®è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /path/to/your/keystore.jks

ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„
vim server.properties
# æŸ¥æ‰¾ ssl.keystore.location é…ç½®é¡¹


ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„
ssl.keystore.location=/opt/kafka/ssl/server.keystore.jks
```

**ğŸ”§ å¿«é€Ÿä¿®å¤æ–¹æ³•**
```bash
# 1. æ‰¾åˆ°å®é™…è¯ä¹¦ä½ç½®

find /opt/kafka -name "*.jks" -type f

# 2. ç¡®è®¤æ–‡ä»¶æƒé™

ls -la /path/to/certificate.jks
# åº”è¯¥æ˜¯ï¼š-rw-r--r-- kafka kafka


# 3. ä¿®æ­£é…ç½®æ–‡ä»¶

sed -i 's|ssl.keystore.location=.*|ssl.keystore.location=/correct/path/server.keystore.jks|' server.properties
```

### 2.2 è¯ä¹¦å¯†ç é…ç½®é”™è¯¯



**âŒ å…¸å‹é”™è¯¯ä¿¡æ¯**
```
java.security.UnrecoverableKeyException: Cannot recover key
Caused by: java.security.UnrecoverableKeyException: Given final block not properly padded
```

**ğŸ” é—®é¢˜æ’æŸ¥æ­¥éª¤**

**æ­¥éª¤1ï¼šéªŒè¯å¯†é’¥åº“å¯†ç **
```bash
# æµ‹è¯•å¯†é’¥åº“æ˜¯å¦èƒ½æ­£å¸¸æ‰“å¼€

keytool -list -keystore server.keystore.jks
# å¦‚æœæç¤ºè¾“å…¥å¯†ç ï¼Œè¯´æ˜å¯†é’¥åº“å®Œå¥½


# æŸ¥çœ‹å¯†é’¥åº“è¯¦ç»†ä¿¡æ¯

keytool -list -v -keystore server.keystore.jks
```

**æ­¥éª¤2ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶å¯†ç **
```bash
# æ£€æŸ¥server.propertiesä¸­çš„å¯†ç é…ç½®

grep -E "ssl.*password" server.properties

# å¸¸è§é…ç½®é¡¹ï¼š

ssl.keystore.password=your_keystore_password
ssl.key.password=your_key_password  
ssl.truststore.password=your_truststore_password
```

**âœ… æ­£ç¡®é…ç½®ç¤ºä¾‹**
```properties
# KafkaæœåŠ¡å™¨SSLé…ç½®

ssl.keystore.location=/opt/kafka/ssl/server.keystore.jks
ssl.keystore.password=server123
ssl.key.password=server123
ssl.truststore.location=/opt/kafka/ssl/server.truststore.jks
ssl.truststore.password=trust123
```

### 2.3 è¯ä¹¦æ ¼å¼é—®é¢˜



**ğŸ”„ æ ¼å¼è½¬æ¢éœ€æ±‚**

Kafkaæ”¯æŒå¤šç§è¯ä¹¦æ ¼å¼ï¼Œä½†æœ€å¸¸ç”¨çš„æ˜¯JKSæ ¼å¼ï¼š

| **æ ¼å¼ç±»å‹** | **æ–‡ä»¶æ‰©å±•å** | **ä½¿ç”¨åœºæ™¯** |
|-------------|---------------|-------------|
| **JKS** | `.jks` | Javaåº”ç”¨é¦–é€‰æ ¼å¼ |
| **PKCS12** | `.p12`, `.pfx` | è·¨å¹³å°é€šç”¨æ ¼å¼ |
| **PEM** | `.pem`, `.crt` | Linuxç³»ç»Ÿå¸¸ç”¨ |

**ğŸ”§ æ ¼å¼è½¬æ¢æ–¹æ³•**
```bash
# PEMè½¬JKSæ ¼å¼

openssl pkcs12 -export -in server.crt -inkey server.key \
  -out server.p12 -name kafka-server

keytool -importkeystore -deststorepass server123 \
  -destkeystore server.keystore.jks \
  -srckeystore server.p12 -srcstoretype PKCS12

# éªŒè¯è½¬æ¢ç»“æœ

keytool -list -keystore server.keystore.jks
```

---

## 3. ğŸ”’ è¯ä¹¦è®¤è¯ç›¸å…³æ•…éšœ



### 3.1 è¯ä¹¦è¿‡æœŸé—®é¢˜



**âš ï¸ è¿‡æœŸç—‡çŠ¶è¯†åˆ«**
```bash
# é”™è¯¯æ—¥å¿—ç‰¹å¾

SSLHandshakeException: sun.security.validator.ValidatorException: 
PKIX path validation failed: java.security.cert.CertPathValidatorException: 
validity check failed
```

**ğŸ” è¯ä¹¦æœ‰æ•ˆæœŸæ£€æŸ¥**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨keytoolæ£€æŸ¥

keytool -list -v -keystore server.keystore.jks | grep -A 2 "Valid from"

# æ–¹æ³•2ï¼šä½¿ç”¨opensslæ£€æŸ¥PEMè¯ä¹¦

openssl x509 -in server.crt -text -noout | grep -A 2 "Validity"

# æ–¹æ³•3ï¼šæ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨è¯ä¹¦

echo | openssl s_client -connect kafka-server:9093 2>/dev/null | \
  openssl x509 -noout -dates
```

**ğŸ› ï¸ è¯ä¹¦æ›´æ–°æµç¨‹**
```bash
# 1. ç”Ÿæˆæ–°çš„è¯ä¹¦è¯·æ±‚

keytool -certreq -alias kafka-server -keystore server.keystore.jks \
  -file server.csr

# 2. ä»CAè·å–æ–°è¯ä¹¦åå¯¼å…¥

keytool -import -alias kafka-server -keystore server.keystore.jks \
  -file new-server.crt

# 3. é‡å¯KafkaæœåŠ¡

systemctl restart kafka
```

### 3.2 è¯ä¹¦é“¾ä¸å®Œæ•´



**ğŸ”— è¯ä¹¦é“¾æ¦‚å¿µè§£é‡Š**
```
è¯ä¹¦é“¾å°±åƒæ¨èä¿¡ï¼š
â€¢ æ ¹è¯ä¹¦ï¼šæœ€é«˜æƒå¨æœºæ„(å¦‚æ”¿åºœ)
â€¢ ä¸­é—´è¯ä¹¦ï¼šä¸­ä»‹æœºæ„(å¦‚å­¦æ ¡)  
â€¢ æœåŠ¡å™¨è¯ä¹¦ï¼šæœ€ç»ˆè¯æ˜(å¦‚æ¯•ä¸šè¯)

å®Œæ•´é“¾æ¡ï¼šæ ¹è¯ä¹¦ â†’ ä¸­é—´è¯ä¹¦ â†’ æœåŠ¡å™¨è¯ä¹¦
```

**âŒ è¯ä¹¦é“¾é—®é¢˜ç—‡çŠ¶**
```
javax.net.ssl.SSLHandshakeException: 
sun.security.validator.ValidatorException: PKIX path building failed
```

**ğŸ”§ ä¿®å¤è¯ä¹¦é“¾**
```bash
# 1. æŸ¥çœ‹å½“å‰è¯ä¹¦é“¾

keytool -list -v -keystore server.keystore.jks

# 2. å¯¼å…¥ç¼ºå¤±çš„ä¸­é—´è¯ä¹¦

keytool -import -alias intermediate-ca -keystore server.keystore.jks \
  -file intermediate.crt

# 3. å¯¼å…¥æ ¹è¯ä¹¦åˆ°ä¿¡ä»»åº“

keytool -import -alias root-ca -keystore server.truststore.jks \
  -file root-ca.crt

# 4. éªŒè¯è¯ä¹¦é“¾å®Œæ•´æ€§

keytool -list -keystore server.keystore.jks | grep -E "(root|intermediate)"
```

### 3.3 å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯å¤±è´¥



**ğŸš« åŒå‘è®¤è¯é—®é¢˜**

å½“å¯ç”¨å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯æ—¶ï¼Œå¸¸è§é—®é¢˜ï¼š

**é…ç½®æ£€æŸ¥æ¸…å•**
- [ ] æœåŠ¡å™¨ç«¯å¯ç”¨äº†å®¢æˆ·ç«¯è®¤è¯ï¼š`ssl.client.auth=required`
- [ ] å®¢æˆ·ç«¯æä¾›äº†æœ‰æ•ˆè¯ä¹¦
- [ ] æœåŠ¡å™¨ä¿¡ä»»åº“åŒ…å«å®¢æˆ·ç«¯CAè¯ä¹¦
- [ ] è¯ä¹¦ç”¨é€”åŒ…å«å®¢æˆ·ç«¯è®¤è¯

**ğŸ”§ å®¢æˆ·ç«¯è¯ä¹¦é…ç½®**
```properties
# å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ client.properties

security.protocol=SSL
ssl.truststore.location=/opt/kafka/ssl/client.truststore.jks
ssl.truststore.password=trust123
ssl.keystore.location=/opt/kafka/ssl/client.keystore.jks
ssl.keystore.password=client123
ssl.key.password=client123
```

**ğŸ§ª å®¢æˆ·ç«¯è®¤è¯æµ‹è¯•**
```bash
# æµ‹è¯•å®¢æˆ·ç«¯è¿æ¥

kafka-console-producer.sh --bootstrap-server kafka-server:9093 \
  --topic test-topic --producer.config client.properties

# å¦‚æœè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—

tail -f /opt/kafka/logs/server.log | grep -i ssl
```

---

## 4. ğŸ”„ SSLåè®®å…¼å®¹æ€§é—®é¢˜



### 4.1 åè®®ç‰ˆæœ¬ä¸åŒ¹é…



**âš ï¸ ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ**

| **Javaç‰ˆæœ¬** | **æ”¯æŒçš„TLSç‰ˆæœ¬** | **æ¨èé…ç½®** |
|-------------|------------------|-------------|
| **Java 8** | TLS 1.0-1.2 | TLSv1.2 |
| **Java 11+** | TLS 1.0-1.3 | TLSv1.3,TLSv1.2 |

**ğŸ”§ åè®®ç‰ˆæœ¬é…ç½®**
```properties
# æœåŠ¡å™¨ç«¯æŒ‡å®šTLSç‰ˆæœ¬

ssl.enabled.protocols=TLSv1.2,TLSv1.3
ssl.protocol=TLS

# å®¢æˆ·ç«¯åŒ¹é…é…ç½®

ssl.enabled.protocols=TLSv1.2,TLSv1.3
ssl.protocol=TLS
```

### 4.2 åŠ å¯†å¥—ä»¶ä¸åŒ¹é…



**ğŸ” åŠ å¯†å¥—ä»¶æ¦‚å¿µ**
```
åŠ å¯†å¥—ä»¶å°±åƒå¯†ç é”çš„å‹å·ï¼š
â€¢ å®¢æˆ·ç«¯ï¼šæˆ‘æ”¯æŒAã€Bã€Cå‹å¯†ç é”
â€¢ æœåŠ¡å™¨ï¼šæˆ‘åªæ¥å—Bã€Cã€Då‹å¯†ç é”
â€¢ åŒ¹é…æˆåŠŸï¼šä½¿ç”¨Bæˆ–Cå‹é”è¿›è¡Œé€šä¿¡
â€¢ åŒ¹é…å¤±è´¥ï¼šæ— æ³•å»ºç«‹è¿æ¥
```

**ğŸ” æŸ¥çœ‹æ”¯æŒçš„åŠ å¯†å¥—ä»¶**
```bash
# æŸ¥çœ‹Javaæ”¯æŒçš„åŠ å¯†å¥—ä»¶

java -Djavax.net.debug=ssl:handshake:verbose YourKafkaClient

# æµ‹è¯•æœåŠ¡å™¨æ”¯æŒçš„å¥—ä»¶

nmap --script ssl-enum-ciphers -p 9093 kafka-server
```

**âš™ï¸ åŠ å¯†å¥—ä»¶é…ç½®**
```properties
# æŒ‡å®šå®‰å…¨çš„åŠ å¯†å¥—ä»¶

ssl.cipher.suites=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256

# æ’é™¤ä¸å®‰å…¨çš„å¥—ä»¶

ssl.cipher.suites=!aNULL,!eNULL,!EXPORT,!DES,!RC4,!MD5,!PSK,!SRP,!CAMELLIA
```

---

## 5. ğŸŒ ç½‘ç»œè¿æ¥å’Œæ¡æ‰‹æ•…éšœ



### 5.1 SSLæ¡æ‰‹è¶…æ—¶



**â° è¶…æ—¶é—®é¢˜è¯Šæ–­**

**å¸¸è§è¶…æ—¶åŸå› **
- ç½‘ç»œå»¶è¿Ÿè¿‡é«˜
- è¯ä¹¦éªŒè¯è€—æ—¶è¿‡é•¿
- DNSè§£æç¼“æ…¢
- é˜²ç«å¢™é˜»æ–­è¿æ¥

**ğŸ”§ è¶…æ—¶å‚æ•°è°ƒä¼˜**
```properties
# å¢åŠ SSLæ¡æ‰‹è¶…æ—¶æ—¶é—´

ssl.handshake.timeout.ms=30000

# è°ƒæ•´ç½‘ç»œè¶…æ—¶å‚æ•°

request.timeout.ms=60000
connections.max.idle.ms=600000
```

**ğŸ§ª ç½‘ç»œè¿é€šæ€§æµ‹è¯•**
```bash
# æµ‹è¯•ç«¯å£è¿é€šæ€§

telnet kafka-server 9093

# æµ‹è¯•SSLè¿æ¥

openssl s_client -connect kafka-server:9093 -servername kafka-server

# æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ

ping kafka-server
traceroute kafka-server
```

### 5.2 é˜²ç«å¢™å’Œç«¯å£é—®é¢˜



**ğŸšª ç«¯å£è®¿é—®æ£€æŸ¥**

**Kafka SSLå¸¸ç”¨ç«¯å£**
- **9093**ï¼šSSLåŠ å¯†è¿æ¥ç«¯å£
- **9094**ï¼šSASL_SSLè¿æ¥ç«¯å£ï¼ˆå¦‚æœå¯ç”¨ï¼‰

**ğŸ”§ é˜²ç«å¢™é…ç½®**
```bash
# CentOS/RHEL ç³»ç»Ÿ

firewall-cmd --permanent --add-port=9093/tcp
firewall-cmd --reload

# Ubuntu/Debian ç³»ç»Ÿ  

ufw allow 9093/tcp

# éªŒè¯ç«¯å£ç›‘å¬

netstat -tlnp | grep 9093
ss -tlnp | grep 9093
```

### 5.3 DNSå’Œä¸»æœºåé—®é¢˜



**ğŸ·ï¸ ä¸»æœºåéªŒè¯**

SSLè¯ä¹¦é€šå¸¸ç»‘å®šç‰¹å®šçš„ä¸»æœºåï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨IPåœ°å€è¿æ¥ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºåéªŒè¯å¤±è´¥ã€‚

**âŒ å…¸å‹é”™è¯¯**
```
java.security.cert.CertificateException: No subject alternative names matching IP address
```

**âœ… è§£å†³æ–¹æ¡ˆ**
```properties
# æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä¸»æœºåè¿æ¥

bootstrap.servers=kafka-server.example.com:9093

# æ–¹æ¡ˆ2ï¼šç¦ç”¨ä¸»æœºåéªŒè¯(ä¸æ¨èç”Ÿäº§ç¯å¢ƒ)

ssl.endpoint.identification.algorithm=

# æ–¹æ¡ˆ3ï¼šæ·»åŠ ä¸»æœºåæ˜ å°„

# åœ¨ /etc/hosts ä¸­æ·»åŠ 

192.168.1.100 kafka-server.example.com
```

---

## 6. ğŸ”§ æ•…éšœè¯Šæ–­å·¥å…·ä¸æ–¹æ³•



### 6.1 æ—¥å¿—åˆ†ææŠ€å·§



**ğŸ“‹ å…³é”®æ—¥å¿—ä½ç½®**
```bash
# KafkaæœåŠ¡å™¨æ—¥å¿—

tail -f /opt/kafka/logs/server.log

# å®¢æˆ·ç«¯åº”ç”¨æ—¥å¿—  

tail -f /var/log/your-app/kafka-client.log

# ç³»ç»ŸSSLæ—¥å¿—

journalctl -u kafka -f | grep -i ssl
```

**ğŸ” é‡è¦æ—¥å¿—å…³é”®è¯**
- `SSLHandshakeException`ï¼šæ¡æ‰‹å¤±è´¥
- `CertificateException`ï¼šè¯ä¹¦é—®é¢˜
- `UnrecoverableKeyException`ï¼šå¯†é’¥é—®é¢˜
- `PKIX path`ï¼šè¯ä¹¦é“¾é—®é¢˜

### 6.2 SSLè°ƒè¯•å‚æ•°



**ğŸ› Java SSLè°ƒè¯•**
```bash
# å¯ç”¨è¯¦ç»†SSLè°ƒè¯•

export KAFKA_OPTS="-Djavax.net.debug=ssl:handshake:verbose"

# å¯åŠ¨KafkaæŸ¥çœ‹SSLè¯¦ç»†ä¿¡æ¯

bin/kafka-server-start.sh config/server.properties

# å®¢æˆ·ç«¯SSLè°ƒè¯•

kafka-console-producer.sh --bootstrap-server kafka-server:9093 \
  --topic test --producer.config client.properties \
  -Djavax.net.debug=ssl
```

### 6.3 åœ¨çº¿å·¥å…·æ£€æµ‹



**ğŸŒ SSLæ£€æµ‹å·¥å…·**

**å‘½ä»¤è¡Œå·¥å…·**
```bash
# æ£€æŸ¥è¯ä¹¦è¯¦æƒ…

openssl s_client -connect kafka-server:9093 -showcerts

# éªŒè¯è¯ä¹¦é“¾

openssl verify -CAfile ca-cert.pem server-cert.pem

# æ£€æŸ¥è¯ä¹¦åŒ¹é…

openssl x509 -noout -modulus -in server.crt | openssl md5
openssl rsa -noout -modulus -in server.key | openssl md5
```

**åœ¨çº¿æ£€æµ‹æœåŠ¡**
- SSL Labs Server Test (é€‚ç”¨äºå…¬ç½‘æœåŠ¡)
- Certificate Decoderå·¥å…·
- SSL Configuration Generator

---

## 7. ğŸ’¡ æœ€ä½³å®è·µå’Œé¢„é˜²æªæ–½



### 7.1 è¯ä¹¦ç®¡ç†æœ€ä½³å®è·µ



**ğŸ“… è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†**

**è¯ä¹¦æ›´æ–°è®¡åˆ’**
```bash
# åˆ›å»ºè¯ä¹¦ç›‘æ§è„šæœ¬

#!/bin/bash

# cert-monitor.sh


CERT_FILE="/opt/kafka/ssl/server.keystore.jks"
WARN_DAYS=30

# æ£€æŸ¥è¯ä¹¦åˆ°æœŸæ—¶é—´

EXPIRE_DATE=$(keytool -list -v -keystore $CERT_FILE -storepass $STORE_PASS | \
  grep "Valid until" | awk '{print $4, $5, $6}')

EXPIRE_TIMESTAMP=$(date -d "$EXPIRE_DATE" +%s)
CURRENT_TIMESTAMP=$(date +%s)
DAYS_LEFT=$(( ($EXPIRE_TIMESTAMP - $CURRENT_TIMESTAMP) / 86400 ))

if [ $DAYS_LEFT -lt $WARN_DAYS ]; then
    echo "âš ï¸ è¯ä¹¦å°†åœ¨ $DAYS_LEFT å¤©åè¿‡æœŸï¼Œè¯·åŠæ—¶æ›´æ–°ï¼"
fi
```

### 7.2 å®‰å…¨é…ç½®å»ºè®®



**ğŸ”’ å®‰å…¨å¼ºåŒ–é…ç½®**
```properties
# ä»…ä½¿ç”¨å®‰å…¨çš„åè®®ç‰ˆæœ¬

ssl.enabled.protocols=TLSv1.2,TLSv1.3

# å¼ºåˆ¶å®¢æˆ·ç«¯è®¤è¯

ssl.client.auth=required

# å¯ç”¨ä¸»æœºåéªŒè¯

ssl.endpoint.identification.algorithm=HTTPS

# ä½¿ç”¨å®‰å…¨çš„åŠ å¯†å¥—ä»¶

ssl.cipher.suites=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
```

### 7.3 ç›‘æ§å’Œå‘Šè­¦



**ğŸ“Š SSLç›‘æ§æŒ‡æ ‡**

**å…³é”®ç›‘æ§é¡¹**
- è¯ä¹¦åˆ°æœŸæ—¶é—´
- SSLæ¡æ‰‹æˆåŠŸç‡
- SSLè¿æ¥é”™è¯¯æ•°é‡
- è¯ä¹¦éªŒè¯å¤±è´¥æ¬¡æ•°

**ğŸš¨ å‘Šè­¦é…ç½®ç¤ºä¾‹**
```bash
# Prometheusç›‘æ§è§„åˆ™

- alert: KafkaSSLCertExpiring
  expr: kafka_ssl_cert_days_to_expiry < 30
  labels:
    severity: warning
  annotations:
    summary: "Kafka SSLè¯ä¹¦å³å°†è¿‡æœŸ"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ SSL/TLSæœ¬è´¨ï¼šä¸ºKafkaé€šä¿¡æä¾›åŠ å¯†å’Œè®¤è¯ä¿æŠ¤
ğŸ”¸ è¯ä¹¦ç»„ä»¶ï¼šå¯†é’¥åº“å­˜è‡ªå·±è¯ä¹¦ï¼Œä¿¡ä»»åº“å­˜ä¿¡ä»»çš„è¯ä¹¦
ğŸ”¸ åŒå‘è®¤è¯ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½éœ€è¦éªŒè¯å¯¹æ–¹èº«ä»½
ğŸ”¸ è¯ä¹¦é“¾ï¼šä»æ ¹è¯ä¹¦åˆ°æœåŠ¡å™¨è¯ä¹¦çš„å®Œæ•´ä¿¡ä»»é“¾æ¡
ğŸ”¸ åè®®å…¼å®¹ï¼šç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ”¯æŒç›¸åŒçš„TLSç‰ˆæœ¬
```

### 8.2 å¸¸è§é—®é¢˜è§£å†³æ€è·¯



**ğŸ”¹ é‡åˆ°SSLé—®é¢˜æ—¶çš„æ’æŸ¥é¡ºåº**
```
ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥è¯ä¹¦æ–‡ä»¶è·¯å¾„å’Œæƒé™
ç¬¬äºŒæ­¥ï¼šéªŒè¯è¯ä¹¦å¯†ç é…ç½®
ç¬¬ä¸‰æ­¥ï¼šç¡®è®¤è¯ä¹¦æœ‰æ•ˆæœŸå’Œæ ¼å¼
ç¬¬å››æ­¥ï¼šæ£€æŸ¥ç½‘ç»œè¿é€šæ€§å’Œç«¯å£
ç¬¬äº”æ­¥ï¼šåˆ†æè¯¦ç»†çš„SSLè°ƒè¯•æ—¥å¿—
```

**ğŸ”¹ é¢„é˜²é—®é¢˜çš„å…³é”®æªæ–½**
```
è¯ä¹¦ç®¡ç†ï¼šå»ºç«‹è¯ä¹¦æ›´æ–°æé†’æœºåˆ¶
é…ç½®æ ‡å‡†åŒ–ï¼šä½¿ç”¨é…ç½®æ¨¡æ¿é¿å…æ‰‹å·¥é”™è¯¯
ç›‘æ§å‘Šè­¦ï¼šå®æ—¶ç›‘æ§SSLè¿æ¥çŠ¶æ€
æµ‹è¯•éªŒè¯ï¼šå®šæœŸè¿›è¡ŒSSLè¿æ¥æµ‹è¯•
```

### 8.3 å®é™…åº”ç”¨å»ºè®®



**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹**
- **è¯ä¹¦æ¥æº**ï¼šä½¿ç”¨å¯ä¿¡CAç­¾å‘çš„è¯ä¹¦ï¼Œé¿å…è‡ªç­¾å
- **å¯†ç å®‰å…¨**ï¼šè¯ä¹¦å¯†ç ä¸è¦ç¡¬ç¼–ç ï¼Œä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿ
- **é«˜å¯ç”¨æ€§**ï¼šé…ç½®å¤šä¸ªKafkaèŠ‚ç‚¹çš„SSLè¯ä¹¦
- **æ€§èƒ½è€ƒè™‘**ï¼šSSLä¼šå¢åŠ CPUå¼€é”€ï¼Œéœ€è¦æ€§èƒ½æµ‹è¯•

**ğŸ“ æ•…éšœå¤„ç†æ£€æŸ¥å•**
- [ ] ç¡®è®¤è¯ä¹¦æ–‡ä»¶è·¯å¾„æ­£ç¡®
- [ ] éªŒè¯æ‰€æœ‰å¯†ç é…ç½®æ— è¯¯
- [ ] æ£€æŸ¥è¯ä¹¦æœªè¿‡æœŸä¸”æ ¼å¼æ­£ç¡®
- [ ] ç¡®ä¿ç½‘ç»œç«¯å£å¼€æ”¾
- [ ] å¯ç”¨SSLè°ƒè¯•æ—¥å¿—åˆ†æé—®é¢˜
- [ ] æµ‹è¯•å®¢æˆ·ç«¯è¿æ¥æ˜¯å¦æ­£å¸¸

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
> SSLå°±åƒç»™æ•°æ®åŠ é”ï¼Œè¯ä¹¦æ˜¯é’¥åŒ™
> è·¯å¾„å¯†ç æ ¼å¼æœŸé™ï¼Œå››é¡¹æ£€æŸ¥ä¸èƒ½å¿˜
> åŒå‘è®¤è¯éœ€ä¸¤è¯ï¼ŒæœåŠ¡å®¢æˆ·éƒ½è¦æœ‰
> é‡åˆ°é—®é¢˜çœ‹æ—¥å¿—ï¼Œè°ƒè¯•å‚æ•°å¸®åŠ©å¤§

**ğŸ’¡ å­¦ä¹ å»ºè®®**
- åœ¨æµ‹è¯•ç¯å¢ƒå¤šç»ƒä¹ è¯ä¹¦é…ç½®
- ç†Ÿæ‚‰å¸¸ç”¨çš„SSLè¯Šæ–­å‘½ä»¤
- äº†è§£ä¸åŒè¯ä¹¦æ ¼å¼çš„è½¬æ¢æ–¹æ³•
- æŒæ¡ç”Ÿäº§ç¯å¢ƒçš„è¯ä¹¦ç®¡ç†æµç¨‹