---
title: 2ã€ZooKeeperè¿æ¥é—®é¢˜
---
## ğŸ“š ç›®å½•

1. [ZooKeeperåŸºç¡€æ¦‚å¿µç†è§£](#1-ZooKeeperåŸºç¡€æ¦‚å¿µç†è§£)
2. [å¸¸è§ZooKeeperè¿æ¥æ•…éšœ](#2-å¸¸è§ZooKeeperè¿æ¥æ•…éšœ)
3. [æ•…éšœè¯Šæ–­æ€è·¯ä¸æ–¹æ³•](#3-æ•…éšœè¯Šæ–­æ€è·¯ä¸æ–¹æ³•)
4. [å…·ä½“é—®é¢˜è§£å†³æ–¹æ¡ˆ](#4-å…·ä½“é—®é¢˜è§£å†³æ–¹æ¡ˆ)
5. [é¢„é˜²æªæ–½ä¸æœ€ä½³å®è·µ](#5-é¢„é˜²æªæ–½ä¸æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ZooKeeperåŸºç¡€æ¦‚å¿µç†è§£


### 1.1 ä»€ä¹ˆæ˜¯ZooKeeper


**é€šä¿—ç†è§£**ï¼š
ZooKeeperå°±åƒæ˜¯**åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤§ç®¡å®¶**ï¼Œä¸“é—¨è´Ÿè´£åè°ƒå’Œç®¡ç†å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´çš„åˆä½œã€‚

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
å°±åƒä¸€ä¸ªå¤§å…¬å¸çš„æ€»æœºæ¥çº¿å‘˜
- è®°å½•æ¯ä¸ªéƒ¨é—¨çš„è”ç³»æ–¹å¼
- åè°ƒå„éƒ¨é—¨ä¹‹é—´çš„æ²Ÿé€š
- ç¡®ä¿ä¿¡æ¯ä¼ é€’å‡†ç¡®æ— è¯¯
- å½“æŸä¸ªéƒ¨é—¨å‡ºé—®é¢˜æ—¶ï¼ŒåŠæ—¶é€šçŸ¥å…¶ä»–éƒ¨é—¨

ZooKeeperåœ¨Kafkaä¸­çš„ä½œç”¨ï¼š
- ç®¡ç†Kafkaé›†ç¾¤ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨
- åè°ƒå„ä¸ªKafkaæœåŠ¡å™¨çš„å·¥ä½œ
- å­˜å‚¨é‡è¦çš„é…ç½®ä¿¡æ¯
- é€‰ä¸¾é›†ç¾¤çš„é¢†å¯¼è€…
```

### 1.2 ZooKeeperä¸Kafkaçš„å…³ç³»


**ä¾èµ–å…³ç³»å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Kafkaåº”ç”¨å±‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Kafka Brokeré›†ç¾¤             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚     â”‚Brokerâ”‚  â”‚Brokerâ”‚  â”‚Brokerâ”‚      â”‚
â”‚     â”‚  1  â”‚  â”‚  2  â”‚  â”‚  3  â”‚      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ZooKeeperé›†ç¾¤               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚     â”‚ ZK1 â”‚  â”‚ ZK2 â”‚  â”‚ ZK3 â”‚      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ æ ¸å¿ƒä½œç”¨**ï¼š
- **é›†ç¾¤ç®¡ç†**ï¼šè°æ˜¯è€å¤§ï¼Œè°åœ¨å·¥ä½œï¼Œè°æ‰çº¿äº†
- **é…ç½®ç®¡ç†**ï¼šå­˜å‚¨ä¸»é¢˜ã€åˆ†åŒºç­‰é‡è¦è®¾ç½®
- **æ•°æ®åŒæ­¥**ï¼šç¡®ä¿æ‰€æœ‰KafkaæœåŠ¡å™¨ä¿¡æ¯ä¸€è‡´
- **æ•…éšœæ£€æµ‹**ï¼šç¬¬ä¸€æ—¶é—´å‘ç°æœåŠ¡å™¨é—®é¢˜

### 1.3 è¿æ¥çš„é‡è¦æ€§


> **é‡è¦æé†’**ï¼šZooKeeperå°±åƒKafkaçš„"å¤§è„‘"ï¼Œä¸€æ—¦è¿æ¥å‡ºé—®é¢˜ï¼Œæ•´ä¸ªKafkaé›†ç¾¤å°±æ— æ³•æ­£å¸¸å·¥ä½œï¼

**è¿æ¥å¤±è´¥çš„åæœ**ï¼š
- âŒ KafkaæœåŠ¡å™¨æ— æ³•å¯åŠ¨
- âŒ æ— æ³•åˆ›å»ºæ–°çš„æ¶ˆæ¯ä¸»é¢˜
- âŒ æ¶ˆæ¯ç”Ÿäº§å’Œæ¶ˆè´¹å‡ºç°å¼‚å¸¸
- âŒ é›†ç¾¤çŠ¶æ€æ— æ³•åŒæ­¥

---

## 2. âš ï¸ å¸¸è§ZooKeeperè¿æ¥æ•…éšœ


### 2.1 æ•…éšœåˆ†ç±»ä¸€è§ˆè¡¨


| **æ•…éšœç±»å‹** | **è¡¨ç°ç—‡çŠ¶** | **å½±å“ç¨‹åº¦** | **è§£å†³éš¾åº¦** |
|-------------|-------------|-------------|-------------|
| ğŸ”´ **æœåŠ¡æœªå¯åŠ¨** | `Connection refused` | **ä¸¥é‡** | **ç®€å•** |
| ğŸŸ¡ **é…ç½®é”™è¯¯** | `UnknownHostException` | **ä¸­ç­‰** | **ç®€å•** |
| ğŸ”´ **ç«¯å£å ç”¨** | `Address already in use` | **ä¸¥é‡** | **ä¸­ç­‰** |
| ğŸŸ¡ **ç½‘ç»œè¶…æ—¶** | `Connection timeout` | **ä¸­ç­‰** | **ä¸­ç­‰** |
| ğŸ”´ **é›†ç¾¤è„‘è£‚** | `NoNodeException` | **ä¸¥é‡** | **å¤æ‚** |
| ğŸŸ¡ **ä¼šè¯è¶…æ—¶** | `Session expired` | **ä¸­ç­‰** | **ç®€å•** |

### 2.2 æ•…éšœè¯†åˆ«æŠ€å·§


**ğŸ’¡ å¿«é€Ÿåˆ¤æ–­æ–¹æ³•**ï¼š

**æ­¥éª¤1ï¼šæ£€æŸ¥é”™è¯¯æ—¥å¿—å…³é”®è¯**
```bash
# å¸¸è§é”™è¯¯å…³é”®è¯
grep -i "connection" kafka.log
grep -i "zookeeper" kafka.log
grep -i "timeout" kafka.log
```

**æ­¥éª¤2ï¼šæŸ¥çœ‹ZooKeeperçŠ¶æ€**
```bash
# æ£€æŸ¥ZKæ˜¯å¦è¿è¡Œ
ps aux | grep zookeeper

# æ£€æŸ¥ZKç«¯å£
netstat -an | grep 2181
```

**æ­¥éª¤3ï¼šæµ‹è¯•è¿æ¥**
```bash
# ç®€å•æµ‹è¯•ZKè¿æ¥
telnet localhost 2181
```

---

## 3. ğŸ”§ æ•…éšœè¯Šæ–­æ€è·¯ä¸æ–¹æ³•


### 3.1 æ ‡å‡†è¯Šæ–­æµç¨‹


```
æ•…éšœå‘ç”Ÿ
    â†“
ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šæ”¶é›†ä¿¡æ¯
â”œâ”€ æŸ¥çœ‹é”™è¯¯æ—¥å¿—
â”œâ”€ è®°å½•æ•…éšœæ—¶é—´
â””â”€ ç¡®è®¤ç¯å¢ƒé…ç½®
    â†“
ğŸ” ç¬¬äºŒæ­¥ï¼šå®šä½é—®é¢˜
â”œâ”€ æ£€æŸ¥æœåŠ¡çŠ¶æ€
â”œâ”€ éªŒè¯ç½‘ç»œè¿é€šæ€§
â””â”€ åˆ†æé…ç½®æ–‡ä»¶
    â†“
ğŸ”§ ç¬¬ä¸‰æ­¥ï¼šè§£å†³é—®é¢˜
â”œâ”€ æŒ‰ä¼˜å…ˆçº§å¤„ç†
â”œâ”€ é€é¡¹éªŒè¯ä¿®å¤
â””â”€ æµ‹è¯•æ¢å¤æ•ˆæœ
    â†“
âœ… ç¬¬å››æ­¥ï¼šéªŒè¯ä¿®å¤
â””â”€ å…¨é¢åŠŸèƒ½æµ‹è¯•
```

### 3.2 è¯Šæ–­å·¥å…·ç®±


**ğŸ› ï¸ å¿…å¤‡è¯Šæ–­å‘½ä»¤**ï¼š

```bash
# ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
systemctl status zookeeper    # æ£€æŸ¥ZKæœåŠ¡çŠ¶æ€
ps aux | grep java            # æŸ¥çœ‹Javaè¿›ç¨‹
df -h                         # æ£€æŸ¥ç£ç›˜ç©ºé—´
free -m                       # æ£€æŸ¥å†…å­˜ä½¿ç”¨

# ç½‘ç»œè¿æ¥æ£€æŸ¥
netstat -tlnp | grep 2181     # æ£€æŸ¥ZKç«¯å£ç›‘å¬
telnet 192.168.1.100 2181     # æµ‹è¯•è¿œç¨‹è¿æ¥
ping 192.168.1.100            # æµ‹è¯•ç½‘ç»œè¿é€šæ€§

# æ—¥å¿—åˆ†æ
tail -f zookeeper.out         # å®æ—¶æŸ¥çœ‹ZKæ—¥å¿—
tail -f server.log            # æŸ¥çœ‹Kafkaæ—¥å¿—
```

### 3.3 è¯Šæ–­å†³ç­–æ ‘


```
è¿æ¥å¤±è´¥ï¼Ÿ
â”œâ”€ YES â†’ æ£€æŸ¥ZKæœåŠ¡çŠ¶æ€
â”‚       â”œâ”€ æœªå¯åŠ¨ â†’ å¯åŠ¨ZooKeeperæœåŠ¡
â”‚       â”œâ”€ å·²å¯åŠ¨ â†’ æ£€æŸ¥ç«¯å£å’Œç½‘ç»œ
â”‚       â””â”€ å¼‚å¸¸çŠ¶æ€ â†’ æŸ¥çœ‹é”™è¯¯æ—¥å¿—
â””â”€ NO â†’ æ£€æŸ¥å…¶ä»–é—®é¢˜
```

---

## 4. ğŸ¯ å…·ä½“é—®é¢˜è§£å†³æ–¹æ¡ˆ


### 4.1 ZooKeeperæœåŠ¡æœªå¯åŠ¨


**ğŸ”¸ æ•…éšœç°è±¡**ï¼š
```
ERROR [main] kafka.Kafka$ - Fatal error during startup
java.net.ConnectException: Connection refused
```

**ğŸ“‹ è§£å†³æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€**
```bash
# æ£€æŸ¥ZooKeeperæ˜¯å¦è¿è¡Œ
sudo systemctl status zookeeper
# æˆ–è€…
ps aux | grep zookeeper
```

**æ­¥éª¤2ï¼šå¯åŠ¨ZooKeeperæœåŠ¡**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ç³»ç»ŸæœåŠ¡
sudo systemctl start zookeeper

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯åŠ¨
cd /opt/kafka
bin/zookeeper-server-start.sh config/zookeeper.properties
```

**æ­¥éª¤3ï¼šéªŒè¯å¯åŠ¨æˆåŠŸ**
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -an | grep 2181
# åº”è¯¥çœ‹åˆ°ï¼štcp6  0  0 :::2181  :::*  LISTEN

# æµ‹è¯•è¿æ¥
echo "ruok" | nc localhost 2181
# æ­£å¸¸å“åº”ï¼šimok
```

### 4.2 è¿æ¥å­—ç¬¦ä¸²é…ç½®é”™è¯¯


**ğŸ”¸ æ•…éšœç°è±¡**ï¼š
```
WARN [main] kafka.utils.VerifiableProperties - Property zookeeper.connect is not valid
java.net.UnknownHostException: wrong-hostname
```

**ğŸ“‹ æ­£ç¡®é…ç½®æ–¹æ³•**ï¼š

**Kafkaé…ç½®æ–‡ä»¶ (server.properties)**ï¼š
```properties
# å•æœºZooKeeperé…ç½®
zookeeper.connect=localhost:2181

# é›†ç¾¤ZooKeeperé…ç½®
zookeeper.connect=zk1:2181,zk2:2181,zk3:2181

# å¸¦è·¯å¾„çš„é…ç½®ï¼ˆæ¨èï¼‰
zookeeper.connect=zk1:2181,zk2:2181,zk3:2181/kafka
```

**âš ï¸ å¸¸è§é…ç½®é”™è¯¯**ï¼š
- âŒ `zookeeper.connect=192.168.1.100`  (ç¼ºå°‘ç«¯å£)
- âŒ `zookeeper.connect=localhost:2182`  (ç«¯å£é”™è¯¯)
- âŒ `zookeeper.connect=zk1:2181 zk2:2181`  (ç¼ºå°‘é€—å·)

### 4.3 ç«¯å£è¢«å ç”¨é—®é¢˜


**ğŸ”¸ æ•…éšœç°è±¡**ï¼š
```
ERROR [main] kafka.zk.EmbeddedZookeeper - 
java.net.BindException: Address already in use
```

**ğŸ“‹ è§£å†³æ–¹æ¡ˆ**ï¼š

**æ­¥éª¤1ï¼šæ‰¾å‡ºå ç”¨ç«¯å£çš„è¿›ç¨‹**
```bash
# æŸ¥çœ‹2181ç«¯å£å ç”¨æƒ…å†µ
sudo lsof -i :2181
# æˆ–è€…
sudo netstat -tlnp | grep 2181
```

**æ­¥éª¤2ï¼šå¤„ç†å ç”¨è¿›ç¨‹**
```bash
# æ–¹æ³•1ï¼šåœæ­¢å†²çªæœåŠ¡
sudo systemctl stop conflicting-service

# æ–¹æ³•2ï¼šæ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <è¿›ç¨‹ID>

# æ–¹æ³•3ï¼šä¿®æ”¹ZooKeeperç«¯å£
vim config/zookeeper.properties
# ä¿®æ”¹ï¼šclientPort=2182
```

### 4.4 ç½‘ç»œè¿æ¥è¶…æ—¶


**ğŸ”¸ æ•…éšœç°è±¡**ï¼š
```
WARN [main] org.apache.zookeeper.ClientCnxn - 
Session 0x0 for server null, unexpected error, closing socket connection
java.net.SocketTimeoutException: connect timed out
```

**ğŸ“‹ è§£å†³æ–¹æ¡ˆ**ï¼š

**æ£€æŸ¥ç½‘ç»œè¿é€šæ€§**ï¼š
```bash
# æµ‹è¯•pingè¿é€šæ€§
ping zookeeper-server-ip

# æµ‹è¯•ç«¯å£è¿é€šæ€§
telnet zookeeper-server-ip 2181

# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status
sudo firewall-cmd --list-all
```

**è°ƒæ•´è¶…æ—¶å‚æ•°**ï¼š
```properties
# server.propertiesä¸­å¢åŠ 
zookeeper.connection.timeout.ms=30000
zookeeper.session.timeout.ms=60000
```

### 4.5 ZooKeeperé›†ç¾¤è„‘è£‚


**ğŸ”¸ ä»€ä¹ˆæ˜¯è„‘è£‚**ï¼š
è„‘è£‚å°±åƒä¸€ä¸ªå…¬å¸åŒæ—¶æœ‰ä¸¤ä¸ªCEOï¼Œæ¯ä¸ªéƒ½è®¤ä¸ºè‡ªå·±æ˜¯è€å¤§ï¼Œé€ æˆç®¡ç†æ··ä¹±ã€‚

**æ•…éšœç°è±¡**ï¼š
```
WARN [main] org.apache.zookeeper.server.quorum.Learner - 
Exception when following the leader
java.net.SocketException: Connection reset
```

**ğŸ“‹ è§£å†³æ–¹æ¡ˆ**ï¼š

**æ­¥éª¤1ï¼šæ£€æŸ¥é›†ç¾¤çŠ¶æ€**
```bash
# æ£€æŸ¥æ¯ä¸ªZKèŠ‚ç‚¹çŠ¶æ€
echo "srvr" | nc zk1 2181
echo "srvr" | nc zk2 2181  
echo "srvr" | nc zk3 2181
```

**æ­¥éª¤2ï¼šé‡å¯é—®é¢˜èŠ‚ç‚¹**
```bash
# åœæ­¢æœ‰é—®é¢˜çš„ZKèŠ‚ç‚¹
sudo systemctl stop zookeeper

# æ¸…ç†æ•°æ®ç›®å½•ï¼ˆæ³¨æ„å¤‡ä»½ï¼‰
rm -rf /var/lib/zookeeper/version-2/*

# é‡å¯èŠ‚ç‚¹
sudo systemctl start zookeeper
```

### 4.6 ä¼šè¯è¶…æ—¶é—®é¢˜


**ğŸ”¸ æ•…éšœç°è±¡**ï¼š
```
INFO [main] org.apache.zookeeper.ClientCnxn - 
Session 0x16e23b5e5560001 for server null, unexpected error
KeeperException$SessionExpiredException: KeeperErrorCode = Session expired
```

**ğŸ“‹ è§£å†³æ–¹æ¡ˆ**ï¼š

**è°ƒæ•´ä¼šè¯å‚æ•°**ï¼š
```properties
# zookeeper.properties
tickTime=3000
initLimit=10
syncLimit=5

# server.properties  
zookeeper.session.timeout.ms=30000
```

**ç³»ç»Ÿä¼˜åŒ–**ï¼š
```bash
# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
top
iostat -x 1

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
find /var/log -name "*.log" -mtime +7 -delete
```

---

## 5. ğŸ›¡ï¸ é¢„é˜²æªæ–½ä¸æœ€ä½³å®è·µ


### 5.1 ç›‘æ§è®¾ç½®


**ğŸ”¸ å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

| **ç›‘æ§é¡¹ç›®** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** | **ç›‘æ§å·¥å…·** |
|-------------|-------------|-------------|-------------|
| ZKæœåŠ¡çŠ¶æ€ | Running | Down | `systemctl` |
| ç«¯å£ç›‘å¬ | 2181 Active | Not Listening | `netstat` |
| ç£ç›˜ç©ºé—´ | < 80% | > 90% | `df -h` |
| å†…å­˜ä½¿ç”¨ | < 70% | > 85% | `free -m` |
| ç½‘ç»œå»¶è¿Ÿ | < 10ms | > 50ms | `ping` |

**ç›‘æ§è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# zk_health_check.sh

# æ£€æŸ¥ZKæœåŠ¡çŠ¶æ€
if ! systemctl is-active --quiet zookeeper; then
    echo "ALERT: ZooKeeper service is down!"
    exit 1
fi

# æ£€æŸ¥ç«¯å£ç›‘å¬
if ! netstat -an | grep -q ":2181.*LISTEN"; then
    echo "ALERT: ZooKeeper port not listening!"
    exit 1
fi

echo "ZooKeeper health check passed"
```

### 5.2 é…ç½®ä¼˜åŒ–å»ºè®®


**ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿**ï¼š

**zookeeper.propertiesä¼˜åŒ–**ï¼š
```properties
# åŸºç¡€é…ç½®
tickTime=3000
initLimit=10
syncLimit=5
clientPort=2181

# æ€§èƒ½ä¼˜åŒ–
maxClientCnxns=200
autopurge.snapRetainCount=10
autopurge.purgeInterval=1

# æ•°æ®ç›®å½•
dataDir=/var/lib/zookeeper
dataLogDir=/var/log/zookeeper

# é›†ç¾¤é…ç½®
server.1=zk1:2888:3888
server.2=zk2:2888:3888  
server.3=zk3:2888:3888
```

**server.propertiesä¼˜åŒ–**ï¼š
```properties
# ZooKeeperè¿æ¥
zookeeper.connect=zk1:2181,zk2:2181,zk3:2181/kafka
zookeeper.connection.timeout.ms=18000
zookeeper.session.timeout.ms=30000

# ç½‘ç»œé…ç½®
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
```

### 5.3 æ—¥å¸¸ç»´æŠ¤æ¸…å•


**ğŸ“‹ æ¯æ—¥æ£€æŸ¥é¡¹ç›®**ï¼š
- [ ] ZooKeeperæœåŠ¡çŠ¶æ€
- [ ] ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡
- [ ] é”™è¯¯æ—¥å¿—æ£€æŸ¥
- [ ] ç½‘ç»œè¿é€šæ€§æµ‹è¯•

**ğŸ“‹ æ¯å‘¨ç»´æŠ¤é¡¹ç›®**ï¼š
- [ ] æ¸…ç†è¿‡æœŸæ—¥å¿—æ–‡ä»¶
- [ ] å¤‡ä»½ZooKeeperæ•°æ®
- [ ] æ€§èƒ½æŒ‡æ ‡åˆ†æ
- [ ] å®‰å…¨æ›´æ–°æ£€æŸ¥

**ğŸ“‹ æ¯æœˆä¼˜åŒ–é¡¹ç›®**ï¼š
- [ ] é…ç½®å‚æ•°è°ƒä¼˜
- [ ] å®¹é‡è§„åˆ’è¯„ä¼°
- [ ] æ•…éšœæ¼”ç»ƒæµ‹è¯•
- [ ] æ–‡æ¡£æ›´æ–°ç»´æŠ¤

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ZooKeeperä½œç”¨ï¼šKafkaé›†ç¾¤çš„åè°ƒç®¡ç†ä¸­å¿ƒ
ğŸ”¸ è¿æ¥é‡è¦æ€§ï¼šZKè¿æ¥å¤±è´¥ä¼šå¯¼è‡´æ•´ä¸ªKafkaé›†ç¾¤ä¸å¯ç”¨
ğŸ”¸ æ•…éšœåˆ†ç±»ï¼šæœåŠ¡ã€é…ç½®ã€ç½‘ç»œã€é›†ç¾¤å››å¤§ç±»é—®é¢˜
ğŸ”¸ è¯Šæ–­æ€è·¯ï¼šæ”¶é›†ä¿¡æ¯ â†’ å®šä½é—®é¢˜ â†’ è§£å†³éªŒè¯
ğŸ”¸ é¢„é˜²ä¸ºä¸»ï¼šç›‘æ§å‘Šè­¦ + å®šæœŸç»´æŠ¤ + é…ç½®ä¼˜åŒ–
```

### 6.2 æ•…éšœå¤„ç†ä¼˜å…ˆçº§


**ğŸ”¥ ç´§æ€¥çº§åˆ«**ï¼ˆç«‹å³å¤„ç†ï¼‰ï¼š
- ZooKeeperæœåŠ¡å®Œå…¨ä¸å¯ç”¨
- é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- ç£ç›˜ç©ºé—´æ»¡å¯¼è‡´æœåŠ¡åœæ­¢

**âš ï¸ é‡è¦çº§åˆ«**ï¼ˆ4å°æ—¶å†…å¤„ç†ï¼‰ï¼š
- é—´æ­‡æ€§è¿æ¥è¶…æ—¶
- éƒ¨åˆ†èŠ‚ç‚¹è¿æ¥å¼‚å¸¸
- æ€§èƒ½æ˜æ˜¾ä¸‹é™

**ğŸ“ ä¸€èˆ¬çº§åˆ«**ï¼ˆ24å°æ—¶å†…å¤„ç†ï¼‰ï¼š
- é…ç½®å‚æ•°ä¸å¤Ÿä¼˜åŒ–
- æ—¥å¿—æ–‡ä»¶è¿‡å¤§
- ç›‘æ§å‘Šè­¦è¯¯æŠ¥

### 6.3 å®æˆ˜ç»éªŒæ€»ç»“


**ğŸ¯ æ–°æ‰‹å¸¸çŠ¯é”™è¯¯**ï¼š
1. **å¿˜è®°å¯åŠ¨ZooKeeper**ï¼šKafkaå¯åŠ¨å‰å¿…é¡»å…ˆå¯åŠ¨ZK
2. **é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯**ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦çœŸçš„ç”Ÿæ•ˆ
3. **é˜²ç«å¢™é˜»æŒ¡**ï¼šåˆ«å¿˜äº†å¼€æ”¾2181ç«¯å£
4. **ç£ç›˜ç©ºé—´ä¸è¶³**ï¼šå®šæœŸæ¸…ç†æ—¥å¿—å¾ˆé‡è¦

**ğŸ’¡ ä¸“å®¶å»ºè®®**ï¼š
1. **å»ºç«‹ç›‘æ§ä½“ç³»**ï¼šé—®é¢˜å‘ç”Ÿå‰å°±è¦çŸ¥é“
2. **å®šæœŸå¤‡ä»½é…ç½®**ï¼šé¿å…æ”¹é”™é…ç½®æ— æ³•æ¢å¤  
3. **æ–‡æ¡£åŒ–æ“ä½œ**ï¼šè®°å½•æ¯æ¬¡æ•…éšœçš„è§£å†³è¿‡ç¨‹
4. **æ¼”ç»ƒæ•…éšœåœºæ™¯**ï¼šæå‰å‡†å¤‡åº”å¯¹æ–¹æ¡ˆ

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ZooKeeperæ˜¯Kafkaçš„"å¤§è„‘"ï¼Œè¿æ¥é—®é¢˜å½±å“å…¨å±€
- æ•…éšœè¯Šæ–­è¦ç³»ç»ŸåŒ–ï¼šçœ‹æ—¥å¿—ã€æŸ¥çŠ¶æ€ã€æµ‹è¿æ¥
- é¢„é˜²èƒœäºæ²»ç–—ï¼šç›‘æ§ã€ç»´æŠ¤ã€å¤‡ä»½ä¸‰ç®¡é½ä¸‹
- å¤„ç†é—®é¢˜è¦æœ‰ä¼˜å…ˆçº§ï¼šç´§æ€¥é—®é¢˜ä¼˜å…ˆè§£å†³

### 6.4 å¿«é€Ÿæ•…éšœå®šä½å£è¯€


```
ğŸ” è¿æ¥æ•…éšœä¸è¦æ…Œï¼Œå››æ­¥è¯Šæ–­è§çœŸç« ï¼š
   ä¸€çœ‹æœåŠ¡æ˜¯å¦èµ·ï¼ŒäºŒæŸ¥é…ç½®å¯¹ä¸å¯¹
   ä¸‰æµ‹ç½‘ç»œé€šä¸é€šï¼Œå››éªŒæ—¥å¿—æ‰¾æ ¹å› 
   
ğŸ› ï¸ è§£å†³é—®é¢˜æœ‰é¡ºåºï¼Œè½»é‡ç¼“æ€¥è¦åˆ†æ˜ï¼š
   æœåŠ¡æ•…éšœå…ˆå¤„ç†ï¼Œé…ç½®é”™è¯¯è¦ç»†å¿ƒ  
   ç½‘ç»œé—®é¢˜æŸ¥é˜²ç«å¢™ï¼Œé›†ç¾¤è„‘è£‚éœ€é‡å¯
   
ğŸ“Š é¢„é˜²æªæ–½è¦åšå¥½ï¼Œç›‘æ§ç»´æŠ¤ä¸èƒ½å°‘ï¼š
   å®šæ—¶æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼ŒåŠæ—¶æ¸…ç†æ—§æ—¥å¿—
   å¤‡ä»½é…ç½®å¾ˆé‡è¦ï¼Œæ–‡æ¡£è®°å½•æ›´éœ€è¦
```