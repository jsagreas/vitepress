---
title: 1ã€ç¯å¢ƒä¾èµ–é—®é¢˜æ’æŸ¥
---
## ğŸ“š ç›®å½•

1. [Kafkaç¯å¢ƒä¾èµ–æ¦‚è¿°](#1-kafkaç¯å¢ƒä¾èµ–æ¦‚è¿°)
2. [Javaç¯å¢ƒé—®é¢˜æ’æŸ¥](#2-javaç¯å¢ƒé—®é¢˜æ’æŸ¥)
3. [ç³»ç»Ÿæƒé™ä¸å®‰å…¨é…ç½®](#3-ç³»ç»Ÿæƒé™ä¸å®‰å…¨é…ç½®)
4. [ç½‘ç»œè¿æ¥é—®é¢˜è¯Šæ–­](#4-ç½‘ç»œè¿æ¥é—®é¢˜è¯Šæ–­)
5. [ç³»ç»Ÿèµ„æºé™åˆ¶é—®é¢˜](#5-ç³»ç»Ÿèµ„æºé™åˆ¶é—®é¢˜)
6. [æ•…éšœæ’æŸ¥å·¥å…·ä¸æŠ€å·§](#6-æ•…éšœæ’æŸ¥å·¥å…·ä¸æŠ€å·§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Kafkaç¯å¢ƒä¾èµ–æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç¯å¢ƒä¾èµ–é—®é¢˜


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
å°±åƒæˆ‘ä»¬è¦å¼€è½¦éœ€è¦å…ˆæœ‰é©¾ç…§ã€æ±½æ²¹ã€é€šç•…çš„é“è·¯ä¸€æ ·ï¼ŒKafkaè¦æ­£å¸¸è¿è¡Œä¹Ÿéœ€è¦æ»¡è¶³ä¸€ç³»åˆ—"åŸºç¡€æ¡ä»¶"ã€‚è¿™äº›åŸºç¡€æ¡ä»¶å°±æ˜¯ç¯å¢ƒä¾èµ–ã€‚

```
Kafkaè¿è¡Œçš„å¿…å¤‡æ¡ä»¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Javaè¿è¡Œç¯å¢ƒ      â”‚ â† å¿…é¡»æœ‰åˆé€‚ç‰ˆæœ¬çš„Java
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ç³»ç»Ÿæƒé™é…ç½®      â”‚ â† èƒ½å¤Ÿè¯»å†™æ–‡ä»¶ã€åˆ›å»ºç›®å½•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ç½‘ç»œè¿æ¥æ­£å¸¸      â”‚ â† å„ä¸ªç»„ä»¶èƒ½äº’ç›¸é€šä¿¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    è¶³å¤Ÿç³»ç»Ÿèµ„æº      â”‚ â† å†…å­˜ã€ç£ç›˜ã€æ–‡ä»¶å¥æŸ„ç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç¯å¢ƒä¾èµ–é—®é¢˜çš„ç‰¹ç‚¹


**ğŸ”¸ é—®é¢˜ç‰¹å¾**ï¼š
- **éšè”½æ€§å¼º**ï¼šé”™è¯¯ä¿¡æ¯å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ ¹æºå¾ˆç®€å•
- **å½±å“èŒƒå›´å¤§**ï¼šä¸€ä¸ªç¯å¢ƒé—®é¢˜å¯èƒ½å¯¼è‡´æ•´ä¸ªKafkaé›†ç¾¤æ— æ³•å¯åŠ¨
- **æ˜“äºé¢„é˜²**ï¼šå¤§éƒ¨åˆ†é—®é¢˜éƒ½å¯ä»¥é€šè¿‡è§„èŒƒçš„éƒ¨ç½²æµç¨‹é¿å…

**å¸¸è§è¡¨ç°**ï¼š
```
âŒ å¯åŠ¨æ—¶æŠ¥é”™ï¼šæ‰¾ä¸åˆ°Javaå‘½ä»¤
âŒ æƒé™æ‹’ç»ï¼šæ— æ³•åˆ›å»ºæ—¥å¿—æ–‡ä»¶
âŒ è¿æ¥è¶…æ—¶ï¼šèŠ‚ç‚¹é—´æ— æ³•é€šä¿¡
âŒ å†…å­˜ä¸è¶³ï¼šJVMå¯åŠ¨å¤±è´¥
```

---

## 2. â˜• Javaç¯å¢ƒé—®é¢˜æ’æŸ¥


### 2.1 Javaç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜


**ğŸ” é—®é¢˜æè¿°**ï¼š
Kafkaå¯¹Javaç‰ˆæœ¬æœ‰æ˜ç¡®è¦æ±‚ï¼Œä½¿ç”¨ä¸å…¼å®¹çš„Javaç‰ˆæœ¬ä¼šå¯¼è‡´å¯åŠ¨å¤±è´¥æˆ–è¿è¡Œå¼‚å¸¸ã€‚

**ğŸ“‹ ç‰ˆæœ¬å…¼å®¹å¯¹ç…§è¡¨**ï¼š

| Kafkaç‰ˆæœ¬ | **æœ€ä½Javaç‰ˆæœ¬** | **æ¨èJavaç‰ˆæœ¬** | **æ³¨æ„äº‹é¡¹** |
|-----------|-----------------|-----------------|-------------|
| 2.8.x | `Java 8` | `Java 11` | `æ”¯æŒJava 17` |
| 3.0.x | `Java 8` | `Java 11` | `æ¨èJava 11+` |
| 3.4.x+ | `Java 8` | `Java 17` | `Java 8å³å°†ä¸æ”¯æŒ` |

**ğŸ”§ æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥å½“å‰Javaç‰ˆæœ¬
java -version

# æ­£ç¡®è¾“å‡ºç¤ºä¾‹ï¼š
# openjdk version "11.0.16" 2022-07-19
# OpenJDK Runtime Environment (build 11.0.16+8-post-Ubuntu-0ubuntu120.04)

# 2. æ£€æŸ¥JAVA_HOMEç¯å¢ƒå˜é‡
echo $JAVA_HOME
# åº”è¯¥è¾“å‡ºï¼š/usr/lib/jvm/java-11-openjdk-amd64

# 3. éªŒè¯javacç¼–è¯‘å™¨ï¼ˆå¯é€‰ï¼‰
javac -version
```

**âš ï¸ å¸¸è§é”™è¯¯ä¸è§£å†³**ï¼š

```bash
# é”™è¯¯1ï¼šcommand not found: java
# è§£å†³ï¼šå®‰è£…Javaæˆ–ä¿®æ­£PATH
sudo apt update
sudo apt install openjdk-11-jdk

# é”™è¯¯2ï¼šJAVA_HOMEæœªè®¾ç½®
# è§£å†³ï¼šåœ¨~/.bashrcä¸­æ·»åŠ 
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH
source ~/.bashrc
```

### 2.2 JAVA_HOMEé…ç½®é—®é¢˜


**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦JAVA_HOME**ï¼š
Kafkaçš„å¯åŠ¨è„šæœ¬éœ€è¦çŸ¥é“Javaå®‰è£…åœ¨å“ªé‡Œï¼ŒJAVA_HOMEå°±æ˜¯å‘Šè¯‰å®ƒJavaçš„"å®¶"åœ¨å“ªã€‚

**ğŸ”§ æ­£ç¡®é…ç½®æ–¹æ³•**ï¼š

```bash
# 1. æ‰¾åˆ°Javaå®‰è£…ä½ç½®
sudo find /usr -name "java" -type f 2>/dev/null | grep bin
# è¾“å‡ºï¼š/usr/lib/jvm/java-11-openjdk-amd64/bin/java

# 2. è®¾ç½®JAVA_HOMEï¼ˆå»æ‰/bin/javaéƒ¨åˆ†ï¼‰
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64

# 3. æ°¸ä¹…ç”Ÿæ•ˆï¼šç¼–è¾‘ç¯å¢ƒé…ç½®
vim ~/.bashrc
# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH

# 4. é‡æ–°åŠ è½½é…ç½®
source ~/.bashrc
```

**ğŸ§ª éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®**ï¼š

```bash
# æµ‹è¯•1ï¼šéªŒè¯JAVA_HOME
ls $JAVA_HOME/bin/java
# åº”è¯¥æ˜¾ç¤ºï¼š/usr/lib/jvm/java-11-openjdk-amd64/bin/java

# æµ‹è¯•2ï¼šä½¿ç”¨JAVA_HOMEå¯åŠ¨Java
$JAVA_HOME/bin/java -version
# åº”è¯¥æ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

### 2.3 PATHè·¯å¾„é…ç½®é”™è¯¯


**ğŸ¯ é—®é¢˜æœ¬è´¨**ï¼š
ç³»ç»Ÿæ‰¾ä¸åˆ°javaå‘½ä»¤ï¼Œé€šå¸¸æ˜¯å› ä¸ºJavaçš„binç›®å½•æ²¡æœ‰åŠ å…¥åˆ°PATHç¯å¢ƒå˜é‡ä¸­ã€‚

**ğŸ“Š PATHé…ç½®æ£€æŸ¥**ï¼š

```bash
# 1. æŸ¥çœ‹å½“å‰PATH
echo $PATH | tr ':' '\n'
# åº”è¯¥åŒ…å«ç±»ä¼¼ï¼š/usr/lib/jvm/java-11-openjdk-amd64/bin

# 2. æ£€æŸ¥whichå‘½ä»¤ç»“æœ
which java
# æ­£ç¡®è¾“å‡ºï¼š/usr/lib/jvm/java-11-openjdk-amd64/bin/java

# 3. å¦‚æœæ‰¾ä¸åˆ°ï¼Œæ‰‹åŠ¨æ·»åŠ åˆ°PATH
export PATH=$JAVA_HOME/bin:$PATH
```

---

## 3. ğŸ” ç³»ç»Ÿæƒé™ä¸å®‰å…¨é…ç½®


### 3.1 ç”¨æˆ·æƒé™ä¸è¶³é—®é¢˜


**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
å°±åƒä½ è¦åœ¨æŸä¸ªæ–‡ä»¶å¤¹é‡Œæ”¾ä¸œè¥¿ï¼Œå¿…é¡»æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹çš„å†™æƒé™ä¸€æ ·ï¼ŒKafkaéœ€è¦åœ¨æŒ‡å®šç›®å½•åˆ›å»ºæ—¥å¿—æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶ç­‰ï¼Œå¿…é¡»æœ‰è¶³å¤Ÿçš„æƒé™ã€‚

**ğŸ” æƒé™é—®é¢˜æ’æŸ¥**ï¼š

```bash
# 1. æ£€æŸ¥Kafkaå®‰è£…ç›®å½•æƒé™
ls -la /opt/kafka/
# æŸ¥çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è¯»å†™æƒé™

# 2. æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
ls -la /tmp/kafka-logs/
# æˆ–è€…ä½ é…ç½®çš„log.dirsç›®å½•

# 3. æ£€æŸ¥å½“å‰ç”¨æˆ·
whoami
id
# æŸ¥çœ‹ç”¨æˆ·ç»„ä¿¡æ¯
```

**ğŸ”§ æƒé™é—®é¢˜è§£å†³**ï¼š

```bash
# æ–¹æ¡ˆ1ï¼šä¿®æ”¹ç›®å½•æ‰€æœ‰è€…
sudo chown -R kafka:kafka /opt/kafka/
sudo chown -R kafka:kafka /tmp/kafka-logs/

# æ–¹æ¡ˆ2ï¼šä¿®æ”¹ç›®å½•æƒé™
sudo chmod -R 755 /opt/kafka/
sudo chmod -R 755 /tmp/kafka-logs/

# æ–¹æ¡ˆ3ï¼šåˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆæ¨èï¼‰
sudo useradd -r -s /bin/false kafka
sudo mkdir -p /opt/kafka /var/log/kafka
sudo chown -R kafka:kafka /opt/kafka /var/log/kafka
```

### 3.2 é˜²ç«å¢™ç«¯å£é˜»æ–­


**ğŸ¯ Kafkaé»˜è®¤ç«¯å£è¯´æ˜**ï¼š

```
Kafkaå…³é”®ç«¯å£ï¼š
â”œâ”€â”€ 9092  â† Kafka Brokeré»˜è®¤ç«¯å£ï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰
â”œâ”€â”€ 9093  â† SSLåŠ å¯†è¿æ¥ç«¯å£
â”œâ”€â”€ 2181  â† Zookeeperå®¢æˆ·ç«¯ç«¯å£
â”œâ”€â”€ 2888  â† Zookeeperé›†ç¾¤é€šä¿¡ç«¯å£
â””â”€â”€ 3888  â† Zookeeperé€‰ä¸¾ç«¯å£
```

**ğŸ”§ é˜²ç«å¢™æ£€æŸ¥ä¸é…ç½®**ï¼š

```bash
# 1. æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status
# æˆ–è€…
sudo systemctl status firewalld

# 2. æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
sudo netstat -tulpn | grep :9092
sudo ss -tulpn | grep :9092

# 3. å¼€æ”¾Kafkaç«¯å£ï¼ˆUbuntu/ufwï¼‰
sudo ufw allow 9092
sudo ufw allow 2181

# 4. å¼€æ”¾ç«¯å£ï¼ˆCentOS/firewalldï¼‰
sudo firewall-cmd --permanent --add-port=9092/tcp
sudo firewall-cmd --permanent --add-port=2181/tcp
sudo firewall-cmd --reload
```

### 3.3 SELinuxå®‰å…¨ç­–ç•¥é™åˆ¶


**ğŸ’¡ ä»€ä¹ˆæ˜¯SELinux**ï¼š
SELinuxæ˜¯Linuxçš„å®‰å…¨æ¨¡å—ï¼Œå®ƒä¼šé™åˆ¶ç¨‹åºçš„è¡Œä¸ºã€‚æœ‰æ—¶å€™å®ƒä¼šé˜»æ­¢Kafkaè®¿é—®æŸäº›æ–‡ä»¶æˆ–ç«¯å£ã€‚

**ğŸ” SELinuxé—®é¢˜è¯Šæ–­**ï¼š

```bash
# 1. æ£€æŸ¥SELinuxçŠ¶æ€
sestatus
getenforce

# 2. æŸ¥çœ‹SELinuxæ—¥å¿—
sudo tail -f /var/log/audit/audit.log | grep kafka
sudo journalctl -f | grep SELinux

# 3. ä¸´æ—¶å…³é—­SELinuxï¼ˆç”¨äºæµ‹è¯•ï¼‰
sudo setenforce 0
```

**ğŸ”§ SELinuxé…ç½®è§£å†³**ï¼š

```bash
# æ°¸ä¹…å…³é—­SELinuxï¼ˆä¸æ¨èï¼‰
sudo vim /etc/selinux/config
# ä¿®æ”¹ï¼šSELINUX=disabled

# æ¨èï¼šä¸ºKafkaé…ç½®SELinuxç­–ç•¥
sudo setsebool -P httpd_can_network_connect 1
sudo semanage port -a -t http_port_t -p tcp 9092
```

---

## 4. ğŸŒ ç½‘ç»œè¿æ¥é—®é¢˜è¯Šæ–­


### 4.1 ä¸»æœºåè§£æå¤±è´¥


**ğŸ’¡ é—®é¢˜ç°è±¡**ï¼š
KafkaèŠ‚ç‚¹é—´æ— æ³•é€šè¿‡ä¸»æœºåæ‰¾åˆ°å½¼æ­¤ï¼Œå¯¼è‡´é›†ç¾¤é€šä¿¡å¤±è´¥ã€‚

**ğŸ” ä¸»æœºåè§£ææ£€æŸ¥**ï¼š

```bash
# 1. æ£€æŸ¥ä¸»æœºå
hostname
hostname -f  # å®Œå…¨é™å®šåŸŸå

# 2. æµ‹è¯•ä¸»æœºåè§£æ
nslookup $(hostname)
ping $(hostname)

# 3. æ£€æŸ¥hostsæ–‡ä»¶
cat /etc/hosts
# åº”è¯¥åŒ…å«ï¼š
# 127.0.0.1 localhost
# 192.168.1.10 kafka1.example.com kafka1
```

**ğŸ”§ ä¸»æœºåé…ç½®ä¿®å¤**ï¼š

```bash
# 1. é…ç½®/etc/hostsæ–‡ä»¶
sudo vim /etc/hosts
# æ·»åŠ é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ï¼š
192.168.1.10 kafka1.example.com kafka1
192.168.1.11 kafka2.example.com kafka2
192.168.1.12 kafka3.example.com kafka3

# 2. è®¾ç½®ä¸»æœºå
sudo hostnamectl set-hostname kafka1.example.com

# 3. éªŒè¯é…ç½®
ping kafka2.example.com
```

### 4.2 ç½‘ç»œè¿æ¥é…ç½®é”™è¯¯


**ğŸ¯ å¸¸è§ç½‘ç»œé—®é¢˜**ï¼š

```
ç½‘ç»œè¿æ¥é—®é¢˜è¯Šæ–­æµç¨‹ï¼š
å®¢æˆ·ç«¯ â†’ è´Ÿè½½å‡è¡¡ â†’ Kafka Broker
   â†“         â†“         â†“
æ£€æŸ¥ç«¯å£   æ£€æŸ¥è½¬å‘   æ£€æŸ¥ç›‘å¬
```

**ğŸ”§ ç½‘ç»œè¿æ¥æµ‹è¯•**ï¼š

```bash
# 1. æ£€æŸ¥Kafkaæ˜¯å¦åœ¨ç›‘å¬ç«¯å£
sudo netstat -tlnp | grep 9092
# æœŸæœ›è¾“å‡ºï¼štcp6 0 0 :::9092 :::* LISTEN 12345/java

# 2. ä»å…¶ä»–æœºå™¨æµ‹è¯•è¿æ¥
telnet kafka1.example.com 9092
nc -zv kafka1.example.com 9092

# 3. æ£€æŸ¥ç½‘ç»œè·¯ç”±
traceroute kafka1.example.com
```

**âš ï¸ é…ç½®æ–‡ä»¶æ£€æŸ¥**ï¼š

```bash
# æ£€æŸ¥server.propertiesä¸­çš„ç½‘ç»œé…ç½®
grep -E "(listeners|advertised)" /opt/kafka/config/server.properties

# æ­£ç¡®é…ç½®ç¤ºä¾‹ï¼š
# listeners=PLAINTEXT://0.0.0.0:9092
# advertised.listeners=PLAINTEXT://kafka1.example.com:9092
```

---

## 5. ğŸ’¾ ç³»ç»Ÿèµ„æºé™åˆ¶é—®é¢˜


### 5.1 å†…å­˜ä¸è¶³é—®é¢˜


**ğŸ’¡ å†…å­˜éœ€æ±‚è¯´æ˜**ï¼š
Kafkaéœ€è¦è¶³å¤Ÿçš„å†…å­˜æ¥è¿è¡ŒJVMï¼Œå¤„ç†æ¶ˆæ¯ç¼“å­˜ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿä¼šå¯¼è‡´å¯åŠ¨å¤±è´¥æˆ–æ€§èƒ½é—®é¢˜ã€‚

**ğŸ“Š å†…å­˜ä½¿ç”¨æ£€æŸ¥**ï¼š

```bash
# 1. æ£€æŸ¥ç³»ç»Ÿæ€»å†…å­˜
free -h
#              total   used   free   available
# Mem:          7.8G   2.1G   3.2G   5.1G

# 2. æ£€æŸ¥Javaè¿›ç¨‹å†…å­˜ä½¿ç”¨
ps aux | grep kafka | grep -v grep
jmap -heap <kafka-pid>

# 3. æ£€æŸ¥JVMå†…å­˜é…ç½®
ps aux | grep kafka | grep -E "\-Xm[sx]"
```

**ğŸ”§ å†…å­˜é…ç½®ä¼˜åŒ–**ï¼š

```bash
# 1. ä¿®æ”¹Kafkaå¯åŠ¨è„šæœ¬çš„JVMå‚æ•°
vim /opt/kafka/bin/kafka-server-start.sh

# 2. è®¾ç½®åˆé€‚çš„å †å†…å­˜ï¼ˆæ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´ï¼‰
export KAFKA_HEAP_OPTS="-Xmx1G -Xms1G"

# 3. æˆ–è€…åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®
echo 'export KAFKA_HEAP_OPTS="-Xmx2G -Xms2G"' >> ~/.bashrc
```

### 5.2 ç£ç›˜ç©ºé—´ä¸è¶³


**ğŸ¯ ç£ç›˜ç©ºé—´ç›‘æ§**ï¼š

```bash
# 1. æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
# /dev/sda1    50G   45G  2.8G  95% /

# 2. æ£€æŸ¥Kafkaæ•°æ®ç›®å½•
du -sh /tmp/kafka-logs/
du -sh /var/log/kafka/

# 3. æŸ¥æ‰¾å¤§æ–‡ä»¶
find /tmp/kafka-logs/ -type f -size +100M -ls
```

**ğŸ”§ ç£ç›˜ç©ºé—´é‡Šæ”¾**ï¼š

```bash
# 1. æ¸…ç†æ—§çš„æ—¥å¿—åˆ†æ®µ
# åœ¨server.propertiesä¸­é…ç½®ï¼š
# log.retention.hours=168   # ä¿ç•™7å¤©
# log.segment.bytes=1073741824  # 1GBåˆ†æ®µ

# 2. æ‰‹åŠ¨æ¸…ç†ï¼ˆè°¨æ…æ“ä½œï¼‰
# åœæ­¢Kafkaåæ¸…ç†__consumer_offsetsä¸»é¢˜çš„æ—§åˆ†æ®µ
sudo rm -rf /tmp/kafka-logs/__consumer_offsets-*/*.log.deleted

# 3. é…ç½®æ—¥å¿—æ»šåŠ¨
# log.roll.hours=24  # æ¯24å°æ—¶æ»šåŠ¨ä¸€æ¬¡
```

### 5.3 æ–‡ä»¶å¥æŸ„æ•°é™åˆ¶


**ğŸ’¡ ä»€ä¹ˆæ˜¯æ–‡ä»¶å¥æŸ„**ï¼š
æ–‡ä»¶å¥æŸ„å°±åƒæ˜¯ç¨‹åºæ‰“å¼€æ–‡ä»¶çš„"ç¥¨æ®"ï¼ŒKafkaéœ€è¦åŒæ—¶æ‰“å¼€å¾ˆå¤šæ–‡ä»¶ï¼ˆæ—¥å¿—ã€ç´¢å¼•ç­‰ï¼‰ï¼Œå¦‚æœå¥æŸ„æ•°ä¸å¤Ÿä¼šæŠ¥"Too many open files"é”™è¯¯ã€‚

**ğŸ” æ–‡ä»¶å¥æŸ„æ£€æŸ¥**ï¼š

```bash
# 1. æ£€æŸ¥å½“å‰ç”¨æˆ·çš„æ–‡ä»¶å¥æŸ„é™åˆ¶
ulimit -n
# åº”è¯¥æ˜¾ç¤ºä¸€ä¸ªæ•°å­—ï¼Œæ¯”å¦‚ï¼š65536

# 2. æ£€æŸ¥ç³»ç»Ÿçº§åˆ«é™åˆ¶
cat /proc/sys/fs/file-max

# 3. æ£€æŸ¥Kafkaè¿›ç¨‹å®é™…ä½¿ç”¨çš„å¥æŸ„æ•°
lsof -p <kafka-pid> | wc -l
```

**ğŸ”§ æ–‡ä»¶å¥æŸ„é™åˆ¶è°ƒæ•´**ï¼š

```bash
# 1. ä¸´æ—¶è°ƒæ•´ï¼ˆå½“å‰ä¼šè¯ï¼‰
ulimit -n 65536

# 2. æ°¸ä¹…è°ƒæ•´ï¼šç¼–è¾‘limits.conf
sudo vim /etc/security/limits.conf
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
kafka soft nofile 65536
kafka hard nofile 65536
* soft nofile 65536
* hard nofile 65536

# 3. é‡æ–°ç™»å½•ä½¿é…ç½®ç”Ÿæ•ˆ
# æˆ–è€…é‡å¯ç³»ç»Ÿ
```

---

## 6. ğŸ”§ æ•…éšœæ’æŸ¥å·¥å…·ä¸æŠ€å·§


### 6.1 ç³»ç»Ÿæ—¶é—´åŒæ­¥é—®é¢˜


**ğŸ’¡ ä¸ºä»€ä¹ˆæ—¶é—´åŒæ­¥é‡è¦**ï¼š
Kafkaé›†ç¾¤å„èŠ‚ç‚¹çš„æ—¶é—´å¿…é¡»åŒæ­¥ï¼Œæ—¶é—´åå·®ä¼šå¯¼è‡´æ¶ˆæ¯æ—¶é—´æˆ³æ··ä¹±ï¼Œå½±å“æ¶ˆæ¯é¡ºåºå’Œè¿‡æœŸç­–ç•¥ã€‚

**ğŸ” æ—¶é—´åŒæ­¥æ£€æŸ¥**ï¼š

```bash
# 1. æ£€æŸ¥å½“å‰æ—¶é—´
date
timedatectl status

# 2. æ£€æŸ¥NTPåŒæ­¥çŠ¶æ€
chrony sources -v
# æˆ–è€…
ntpq -p

# 3. æ£€æŸ¥æ—¶åŒºè®¾ç½®
timedatectl list-timezones | grep Asia/Shanghai
```

**ğŸ”§ æ—¶é—´åŒæ­¥é…ç½®**ï¼š

```bash
# 1. å®‰è£…NTPæœåŠ¡
sudo apt install chrony
# æˆ–è€…
sudo yum install chrony

# 2. é…ç½®NTPæœåŠ¡å™¨
sudo vim /etc/chrony/chrony.conf
# æ·»åŠ æˆ–ä¿®æ”¹ï¼š
server ntp1.aliyun.com iburst
server ntp2.aliyun.com iburst

# 3. å¯åŠ¨å¹¶å¯ç”¨æœåŠ¡
sudo systemctl start chronyd
sudo systemctl enable chronyd

# 4. å¼ºåˆ¶åŒæ­¥æ—¶é—´
sudo chrony makestep
```

### 6.2 æ—¥å¿—åˆ†ææŠ€å·§


**ğŸ“‹ Kafkaå…³é”®æ—¥å¿—ä½ç½®**ï¼š

```
Kafkaæ—¥å¿—æ–‡ä»¶åˆ†å¸ƒï¼š
â”œâ”€â”€ server.log        â† ä¸»è¦è¿è¡Œæ—¥å¿—
â”œâ”€â”€ controller.log    â† æ§åˆ¶å™¨æ—¥å¿—
â”œâ”€â”€ kafka-gc.log     â† GCåƒåœ¾æ”¶é›†æ—¥å¿—
â””â”€â”€ kafkaServer.out  â† å¯åŠ¨è¾“å‡ºæ—¥å¿—
```

**ğŸ” æ—¥å¿—åˆ†ææ–¹æ³•**ï¼š

```bash
# 1. æŸ¥çœ‹å¯åŠ¨é”™è¯¯
tail -100 /opt/kafka/logs/server.log | grep ERROR

# 2. å®æ—¶ç›‘æ§æ—¥å¿—
tail -f /opt/kafka/logs/server.log

# 3. æœç´¢ç‰¹å®šé”™è¯¯
grep -i "OutOfMemoryError" /opt/kafka/logs/*
grep -i "permission denied" /opt/kafka/logs/*

# 4. åˆ†æGCæ—¥å¿—
grep "Full GC" /opt/kafka/logs/kafka-gc.log
```

**ğŸ¯ å¸¸è§é”™è¯¯å…³é”®è¯**ï¼š

```bash
# ç½‘ç»œé—®é¢˜å…³é”®è¯
grep -E "(Connection.*refused|timeout|unreachable)" logs/server.log

# æƒé™é—®é¢˜å…³é”®è¯  
grep -E "(Permission.*denied|access.*denied)" logs/server.log

# èµ„æºé—®é¢˜å…³é”®è¯
grep -E "(OutOfMemoryError|Too many open files|No space left)" logs/server.log
```

### 6.3 è¿æ¥æµ‹è¯•å·¥å…·


**ğŸ›  ç½‘ç»œè¿æ¥æµ‹è¯•å¥—ä»¶**ï¼š

```bash
# 1. åŸºç¡€è¿é€šæ€§æµ‹è¯•
ping kafka1.example.com
telnet kafka1.example.com 9092

# 2. ç«¯å£æ‰«ææµ‹è¯•
nmap -p 9092 kafka1.example.com
nc -zv kafka1.example.com 9092

# 3. Kafkaä¸“ç”¨æµ‹è¯•å‘½ä»¤
# æµ‹è¯•ç”Ÿäº§è€…
echo "test message" | /opt/kafka/bin/kafka-console-producer.sh \
  --broker-list localhost:9092 --topic test-topic

# æµ‹è¯•æ¶ˆè´¹è€…
/opt/kafka/bin/kafka-console-consumer.sh \
  --bootstrap-server localhost:9092 --topic test-topic --from-beginning
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ£€æŸ¥æ¸…å•


> ğŸ’¡ **æ•…éšœæ’æŸ¥é»„é‡‘æ³•åˆ™**ï¼š**ç¯å¢ƒå…ˆè¡Œï¼Œé—®é¢˜å¿…ç°ï¼Œé€é¡¹æ’æŸ¥**

**âœ… Javaç¯å¢ƒæ£€æŸ¥æ¸…å•**ï¼š
- [ ] Javaç‰ˆæœ¬å…¼å®¹æ€§ï¼ˆæ¨èJava 11+ï¼‰
- [ ] JAVA_HOMEç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®
- [ ] PATHåŒ…å«Java binç›®å½•
- [ ] javacç¼–è¯‘å™¨å¯ç”¨ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

**âœ… ç³»ç»Ÿæƒé™æ£€æŸ¥æ¸…å•**ï¼š
- [ ] Kafkaè¿›ç¨‹ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™
- [ ] æ—¥å¿—ç›®å½•å¯è¯»å†™
- [ ] æ•°æ®ç›®å½•å¯è¯»å†™
- [ ] é˜²ç«å¢™ç«¯å£å·²å¼€æ”¾ï¼ˆ9092, 2181ç­‰ï¼‰
- [ ] SELinuxé…ç½®æ­£ç¡®

**âœ… ç½‘ç»œè¿æ¥æ£€æŸ¥æ¸…å•**ï¼š
- [ ] ä¸»æœºåå¯æ­£ç¡®è§£æ
- [ ] /etc/hostsæ–‡ä»¶é…ç½®æ­£ç¡®
- [ ] èŠ‚ç‚¹é—´ç½‘ç»œè¿é€š
- [ ] ç«¯å£ç›‘å¬çŠ¶æ€æ­£å¸¸
- [ ] advertised.listenersé…ç½®æ­£ç¡®

**âœ… ç³»ç»Ÿèµ„æºæ£€æŸ¥æ¸…å•**ï¼š
- [ ] å†…å­˜å……è¶³ï¼ˆå»ºè®®8GB+ï¼‰
- [ ] ç£ç›˜ç©ºé—´å……è¶³ï¼ˆå»ºè®®50GB+ï¼‰
- [ ] æ–‡ä»¶å¥æŸ„æ•°å……è¶³ï¼ˆå»ºè®®65536+ï¼‰
- [ ] ç³»ç»Ÿæ—¶é—´åŒæ­¥

### 7.2 å¿«é€Ÿè¯Šæ–­å‘½ä»¤


**ğŸš€ ä¸€é”®ç¯å¢ƒæ£€æŸ¥è„šæœ¬**ï¼š

```bash
#!/bin/bash
echo "=== Kafkaç¯å¢ƒä¾èµ–æ£€æŸ¥ ==="

# 1. Javaç¯å¢ƒæ£€æŸ¥
echo "1. Javaç‰ˆæœ¬ï¼š"
java -version 2>&1 | head -1

echo "2. JAVA_HOMEï¼š"
echo $JAVA_HOME

# 3. æƒé™æ£€æŸ¥
echo "3. Kafkaç›®å½•æƒé™ï¼š"
ls -ld /opt/kafka/ 2>/dev/null || echo "Kafkaç›®å½•ä¸å­˜åœ¨"

# 4. ç«¯å£æ£€æŸ¥
echo "4. ç«¯å£ç›‘å¬çŠ¶æ€ï¼š"
netstat -tlnp | grep :9092 || echo "9092ç«¯å£æœªç›‘å¬"

# 5. èµ„æºæ£€æŸ¥
echo "5. ç³»ç»Ÿèµ„æºï¼š"
echo "å†…å­˜ï¼š$(free -h | grep Mem | awk '{print $4}')"
echo "ç£ç›˜ï¼š$(df -h / | tail -1 | awk '{print $4}')"
echo "æ–‡ä»¶å¥æŸ„ï¼š$(ulimit -n)"

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

### 7.3 æ•…éšœæ’æŸ¥æ€è·¯


**ğŸ¯ åˆ†å±‚æ’æŸ¥æ–¹æ³•**ï¼š

```
æ•…éšœæ’æŸ¥å±‚æ¬¡ï¼š
ç¬¬1å±‚ï¼šåŸºç¡€ç¯å¢ƒ
    â”œâ”€â”€ Javaç‰ˆæœ¬å’Œé…ç½®
    â”œâ”€â”€ ç³»ç»Ÿæƒé™
    â””â”€â”€ ç½‘ç»œè¿é€šæ€§

ç¬¬2å±‚ï¼šèµ„æºé™åˆ¶
    â”œâ”€â”€ å†…å­˜å……è¶³æ€§
    â”œâ”€â”€ ç£ç›˜ç©ºé—´
    â””â”€â”€ æ–‡ä»¶å¥æŸ„æ•°

ç¬¬3å±‚ï¼šé…ç½®æ–‡ä»¶
    â”œâ”€â”€ server.properties
    â”œâ”€â”€ JVMå‚æ•°
    â””â”€â”€ ç½‘ç»œé…ç½®

ç¬¬4å±‚ï¼šè¿è¡Œæ—¶é—®é¢˜
    â”œâ”€â”€ æ—¥å¿—åˆ†æ
    â”œâ”€â”€ è¿›ç¨‹çŠ¶æ€
    â””â”€â”€ æ€§èƒ½ç›‘æ§
```

**ğŸ’¡ è®°å¿†è¦ç‚¹**ï¼š
- **ç¯å¢ƒé—®é¢˜ä¼˜å…ˆæ’æŸ¥**ï¼šå…ˆç¡®ä¿åŸºç¡€ç¯å¢ƒæ­£ç¡®
- **æ—¥å¿—æ˜¯æœ€å¥½çš„è€å¸ˆ**ï¼šé‡åˆ°é—®é¢˜å…ˆçœ‹æ—¥å¿—
- **ä¸€æ¬¡åªæ”¹ä¸€ä¸ªé…ç½®**ï¼šé¿å…å¼•å…¥æ–°é—®é¢˜
- **æµ‹è¯•éªŒè¯æ¯ä¸ªæ­¥éª¤**ï¼šç¡®ä¿ä¿®å¤æœ‰æ•ˆ
- **æ–‡æ¡£è®°å½•è§£å†³æ–¹æ¡ˆ**ï¼šä¾¿äºåç»­å‚è€ƒ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ğŸµ Javaç¯å¢ƒè¦é…å¥½ï¼Œæƒé™ç«¯å£æ£€æŸ¥åˆ°  
> å†…å­˜ç£ç›˜è¦å……è¶³ï¼Œæ—¶é—´åŒæ­¥ä¸èƒ½å°‘  
> æ—¥å¿—é”™è¯¯ä»”ç»†çœ‹ï¼Œé€é¡¹æ’æŸ¥é—®é¢˜æ‰¾