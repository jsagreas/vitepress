---
title: 4ã€æ•°æ®è½¬æ¢å’Œå¤„ç†
---
## ğŸ“š ç›®å½•

1. [æ•°æ®è½¬æ¢åŸºç¡€æ¦‚å¿µ](#1-æ•°æ®è½¬æ¢åŸºç¡€æ¦‚å¿µ)
2. [Single Message Transformsè¯¦è§£](#2-single-message-transformsè¯¦è§£)
3. [å†…ç½®è½¬æ¢å™¨æ·±å…¥è§£æ](#3-å†…ç½®è½¬æ¢å™¨æ·±å…¥è§£æ)
4. [è‡ªå®šä¹‰è½¬æ¢å™¨å¼€å‘](#4-è‡ªå®šä¹‰è½¬æ¢å™¨å¼€å‘)
5. [æ•°æ®å¤„ç†é«˜çº§åº”ç”¨](#5-æ•°æ®å¤„ç†é«˜çº§åº”ç”¨)
6. [è½¬æ¢é“¾é…ç½®ä¸ä¼˜åŒ–](#6-è½¬æ¢é“¾é…ç½®ä¸ä¼˜åŒ–)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ æ•°æ®è½¬æ¢åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®è½¬æ¢


**ç®€å•ç†è§£**ï¼š
æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€å †ä¸åŒæ ¼å¼çš„æ–‡æ¡£éœ€è¦æ•´ç†å½’æ¡£ã€‚æœ‰çš„æ˜¯Wordæ–‡æ¡£ï¼Œæœ‰çš„æ˜¯PDFï¼Œæœ‰çš„æ˜¯å›¾ç‰‡ã€‚åœ¨å½’æ¡£ä¹‹å‰ï¼Œä½ éœ€è¦æŠŠå®ƒä»¬éƒ½è½¬æ¢æˆç»Ÿä¸€çš„æ ¼å¼ã€‚

Kafka Connectä¸­çš„æ•°æ®è½¬æ¢å°±æ˜¯ç±»ä¼¼çš„å·¥ä½œï¼š**åœ¨æ•°æ®ä»æºç³»ç»Ÿæµå‘ç›®æ ‡ç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®è¿›è¡Œæ ¼å¼è°ƒæ•´ã€å†…å®¹ä¿®æ”¹æˆ–ç»“æ„é‡ç»„**ã€‚

```
åŸå§‹æ•°æ®æµç¨‹ï¼š
æºç³»ç»Ÿ â†’ Kafka Connect â†’ ç›®æ ‡ç³»ç»Ÿ

åŠ å…¥è½¬æ¢åï¼š
æºç³»ç»Ÿ â†’ Kafka Connect â†’ [æ•°æ®è½¬æ¢] â†’ ç›®æ ‡ç³»ç»Ÿ
```

**ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è½¬æ¢**ï¼š
- ğŸ”¸ **æ ¼å¼ç»Ÿä¸€**ï¼šä¸åŒç³»ç»Ÿçš„æ•°æ®æ ¼å¼å¯èƒ½ä¸ä¸€æ ·
- ğŸ”¸ **æ•°æ®æ¸…æ´—**ï¼šå»é™¤æ— ç”¨å­—æ®µï¼Œä¿®æ­£é”™è¯¯æ•°æ®
- ğŸ”¸ **ä¸šåŠ¡é€‚é…**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´æ•°æ®ç»“æ„
- ğŸ”¸ **å®‰å…¨åˆè§„**ï¼šæ•æ„Ÿæ•°æ®è„±æ•å¤„ç†

### 1.2 è½¬æ¢å‘ç”Ÿçš„ä½ç½®


**è½¬æ¢æ—¶æœºå›¾ç¤º**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Source    â”‚    â”‚ Kafka Connect   â”‚    â”‚   Target    â”‚
â”‚   System    â”‚    â”‚                 â”‚    â”‚   System    â”‚
â”‚             â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚             â”‚
â”‚   æ•°æ®åº“     â”‚â”€â”€â”€â–ºâ”‚  â”‚ Transform â”‚  â”‚â”€â”€â”€â–ºâ”‚    æ–‡ä»¶     â”‚
â”‚   APIæ¥å£    â”‚    â”‚  â”‚  è½¬æ¢å™¨    â”‚  â”‚    â”‚   å¦ä¸€ä¸ªDB   â”‚
â”‚   æ–‡ä»¶ç³»ç»Ÿ   â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚   æœç´¢å¼•æ“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸¤ç§è½¬æ¢ä½ç½®**ï¼š
- **Sourceç«¯è½¬æ¢**ï¼šæ•°æ®ä»æºç³»ç»Ÿè¯»å–åç«‹å³è½¬æ¢
- **Sinkç«¯è½¬æ¢**ï¼šæ•°æ®å†™å…¥ç›®æ ‡ç³»ç»Ÿå‰è¿›è¡Œè½¬æ¢

### 1.3 è½¬æ¢çš„æ ¸å¿ƒä»·å€¼


> **ğŸ’¡ æ ¸å¿ƒç†å¿µ**ï¼šè®©æ•°æ®åœ¨ä¸åŒç³»ç»Ÿé—´æµåŠ¨æ—¶ï¼Œèƒ½å¤Ÿ"å…¥ä¹¡éšä¿—"ï¼Œé€‚åº”æ¯ä¸ªç³»ç»Ÿçš„ç‰¹ç‚¹å’Œè¦æ±‚ã€‚

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```
ç”µå•†åœºæ™¯ç¤ºä¾‹ï¼š
è®¢å•æ•°æ®åº“å­—æ®µï¼šorder_id, customer_id, amount, create_time
â†“ (è½¬æ¢å¤„ç†)
æ•°æ®ä»“åº“éœ€è¦ï¼šè®¢å•ID, å®¢æˆ·ç¼–å·, é‡‘é¢, åˆ›å»ºæ—¥æœŸ, æ•°æ®æ¥æº

è½¬æ¢æ“ä½œï¼š
1. å­—æ®µé‡å‘½åï¼šorder_id â†’ è®¢å•ID
2. æ ¼å¼è½¬æ¢ï¼šcreate_time â†’ åˆ›å»ºæ—¥æœŸ (æ—¶é—´æ ¼å¼æ ‡å‡†åŒ–)
3. æ–°å¢å­—æ®µï¼šæ•°æ®æ¥æº = "è®¢å•ç³»ç»Ÿ"
4. æ•°æ®éªŒè¯ï¼šé‡‘é¢å¿…é¡»å¤§äº0
```

---

## 2. ğŸ› ï¸ Single Message Transformsè¯¦è§£


### 2.1 SMTæ˜¯ä»€ä¹ˆ


**Single Message Transforms (SMT)**ï¼šé¡¾åæ€ä¹‰å°±æ˜¯**å¯¹å•æ¡æ¶ˆæ¯è¿›è¡Œè½¬æ¢çš„å·¥å…·**ã€‚

**é€šä¿—è§£é‡Š**ï¼š
å°±åƒå·¥å‚æµæ°´çº¿ä¸Šçš„åŠ å·¥ç«™ï¼Œæ¯ä¸ªSMTè½¬æ¢å™¨å°±æ˜¯ä¸€ä¸ªåŠ å·¥ç«™ï¼Œè´Ÿè´£å¯¹ç»è¿‡çš„æ¯æ¡æ•°æ®åšç‰¹å®šçš„å¤„ç†ã€‚

```
æ•°æ®æµç»SMTçš„è¿‡ç¨‹ï¼š
åŸå§‹æ¶ˆæ¯ â†’ SMTè½¬æ¢å™¨1 â†’ SMTè½¬æ¢å™¨2 â†’ SMTè½¬æ¢å™¨3 â†’ æœ€ç»ˆæ¶ˆæ¯

å…·ä½“ä¾‹å­ï¼š
ç”¨æˆ·æ•°æ® â†’ æ·»åŠ æ—¶é—´æˆ³ â†’ æ•æ„Ÿä¿¡æ¯è„±æ• â†’ å­—æ®µé‡å‘½å â†’ å¤„ç†å®Œæˆ
```

### 2.2 SMTçš„å·¥ä½œåŸç†


**æ¶ˆæ¯ç»“æ„è§£æ**ï¼š
Kafkaä¸­çš„æ¯æ¡æ¶ˆæ¯éƒ½åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š
- **Key**ï¼šæ¶ˆæ¯çš„é”®å€¼ï¼ˆç”¨äºåˆ†åŒºï¼‰
- **Value**ï¼šæ¶ˆæ¯çš„ä¸»è¦å†…å®¹
- **Headers**ï¼šæ¶ˆæ¯çš„å…ƒæ•°æ®ä¿¡æ¯
- **Timestamp**ï¼šæ¶ˆæ¯çš„æ—¶é—´æˆ³

```
SMTå¯ä»¥å¤„ç†çš„éƒ¨åˆ†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Kafka Message         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Key: "user_123"        âœ“å¯è½¬æ¢  â”‚
â”‚ Value: {                       â”‚
â”‚   "name": "å¼ ä¸‰",      âœ“å¯è½¬æ¢  â”‚
â”‚   "age": 25,          âœ“å¯è½¬æ¢  â”‚
â”‚   "email": "..."      âœ“å¯è½¬æ¢  â”‚
â”‚ }                              â”‚
â”‚ Headers: {...}         âœ“å¯è½¬æ¢  â”‚
â”‚ Timestamp: 1234567890  âœ“å¯è½¬æ¢  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 SMTé…ç½®åŸºç¡€


**åŸºæœ¬é…ç½®æ ¼å¼**ï¼š
```properties
# SMTé…ç½®çš„é€šç”¨æ ¼å¼
transforms=<è½¬æ¢å™¨åç§°>
transforms.<è½¬æ¢å™¨åç§°>.type=<è½¬æ¢å™¨ç±»å‹>
transforms.<è½¬æ¢å™¨åç§°>.<é…ç½®å‚æ•°>=<å‚æ•°å€¼>
```

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š
```properties
# é…ç½®ä¸€ä¸ªå­—æ®µé‡å‘½åè½¬æ¢å™¨
transforms=renameField
transforms.renameField.type=org.apache.kafka.connect.transforms.ReplaceField$Value
transforms.renameField.renames=old_name:new_name,user_id:customer_id
```

**å¤šä¸ªè½¬æ¢å™¨é“¾å¼é…ç½®**ï¼š
```properties
# é…ç½®å¤šä¸ªè½¬æ¢å™¨æŒ‰é¡ºåºæ‰§è¡Œ
transforms=addTimestamp,renameFields,filterSensitive
transforms.addTimestamp.type=org.apache.kafka.connect.transforms.TimestampConverter$Value
transforms.renameFields.type=org.apache.kafka.connect.transforms.ReplaceField$Value
transforms.filterSensitive.type=org.apache.kafka.connect.transforms.ReplaceField$Value
```

---

## 3. ğŸ”§ å†…ç½®è½¬æ¢å™¨æ·±å…¥è§£æ


### 3.1 å­—æ®µæ“ä½œè½¬æ¢å™¨


#### ReplaceField - å­—æ®µæ›¿æ¢å™¨


**ä½œç”¨**ï¼šå¯¹æ¶ˆæ¯ä¸­çš„å­—æ®µè¿›è¡Œé‡å‘½åã€åˆ é™¤æˆ–æ–°å¢æ“ä½œã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ•°æ®åº“å­—æ®µåä¸ç¬¦åˆç›®æ ‡ç³»ç»Ÿè§„èŒƒ
- éœ€è¦åˆ é™¤æ•æ„Ÿæˆ–æ— ç”¨å­—æ®µ
- éœ€è¦ç»Ÿä¸€å­—æ®µå‘½åé£æ ¼

```properties
# å­—æ®µé‡å‘½åé…ç½®
transforms=replaceField
transforms.replaceField.type=org.apache.kafka.connect.transforms.ReplaceField$Value
transforms.replaceField.renames=user_id:customer_id,created_at:create_time

# åˆ é™¤å­—æ®µé…ç½®
transforms.replaceField.exclude=password,ssn,internal_id

# åªä¿ç•™æŒ‡å®šå­—æ®µ
transforms.replaceField.include=name,email,phone
```

**å®é™…æ•ˆæœæ¼”ç¤º**ï¼š
```
åŸå§‹æ•°æ®ï¼š
{
  "user_id": "12345",
  "user_name": "å¼ ä¸‰",
  "password": "secret123",
  "created_at": "2024-01-01"
}

è½¬æ¢åï¼š
{
  "customer_id": "12345",     // user_id â†’ customer_id
  "user_name": "å¼ ä¸‰",
  "create_time": "2024-01-01" // created_at â†’ create_time
  // passwordå­—æ®µè¢«åˆ é™¤
}
```

#### Cast - æ•°æ®ç±»å‹è½¬æ¢å™¨


**ä½œç”¨**ï¼šæ”¹å˜å­—æ®µçš„æ•°æ®ç±»å‹ã€‚

**å¸¸ç”¨ç±»å‹è½¬æ¢**ï¼š
- å­—ç¬¦ä¸² â†” æ•°å­—
- å­—ç¬¦ä¸² â†” å¸ƒå°”å€¼
- æ•°å­—æ ¼å¼è½¬æ¢

```properties
# ç±»å‹è½¬æ¢é…ç½®
transforms=cast
transforms.cast.type=org.apache.kafka.connect.transforms.Cast$Value
transforms.cast.spec=age:int32,score:float64,is_active:boolean
```

### 3.2 å†…å®¹ä¿®æ”¹è½¬æ¢å™¨


#### MaskField - æ•°æ®è„±æ•å™¨


**ä½œç”¨**ï¼šå¯¹æ•æ„Ÿæ•°æ®è¿›è¡Œè„±æ•å¤„ç†ã€‚

**è„±æ•ç­–ç•¥**ï¼š
- **å®Œå…¨æ©ç **ï¼š`å¼ ä¸‰` â†’ `***`
- **éƒ¨åˆ†æ©ç **ï¼š`13812345678` â†’ `138****5678`
- **nullæ›¿æ¢**ï¼šç›´æ¥è®¾ä¸ºnull

```properties
# è„±æ•é…ç½®
transforms=mask
transforms.mask.type=org.apache.kafka.connect.transforms.MaskField$Value
transforms.mask.fields=phone,email,ssn
transforms.mask.replacement=****
```

#### RegexRouter - æ­£åˆ™è·¯ç”±å™¨


**ä½œç”¨**ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹topicåç§°æˆ–æ¶ˆæ¯è·¯ç”±ã€‚

```properties
# Topicåç§°è½¬æ¢
transforms=route
transforms.route.type=org.apache.kafka.connect.transforms.RegexRouter
transforms.route.regex=test-(.*)
transforms.route.replacement=prod-$1
```

### 3.3 ç»“æ„è°ƒæ•´è½¬æ¢å™¨


#### Flatten - æ•°æ®æ‰å¹³åŒ–


**ä½œç”¨**ï¼šå°†åµŒå¥—çš„JSONç»“æ„æ‰å¹³åŒ–ä¸ºå•å±‚ç»“æ„ã€‚

**è½¬æ¢ç¤ºä¾‹**ï¼š
```
åŸå§‹åµŒå¥—æ•°æ®ï¼š
{
  "user": {
    "profile": {
      "name": "å¼ ä¸‰",
      "age": 25
    },
    "contact": {
      "email": "zhangsan@example.com"
    }
  }
}

æ‰å¹³åŒ–åï¼š
{
  "user.profile.name": "å¼ ä¸‰",
  "user.profile.age": 25,
  "user.contact.email": "zhangsan@example.com"
}
```

```properties
# æ‰å¹³åŒ–é…ç½®
transforms=flatten
transforms.flatten.type=org.apache.kafka.connect.transforms.Flatten$Value
transforms.flatten.delimiter=.
```

### 3.4 æ—¶é—´å¤„ç†è½¬æ¢å™¨


#### TimestampConverter - æ—¶é—´æˆ³è½¬æ¢å™¨


**ä½œç”¨**ï¼šåœ¨ä¸åŒæ—¶é—´æ ¼å¼é—´è¿›è¡Œè½¬æ¢ã€‚

**æ”¯æŒçš„æ—¶é—´æ ¼å¼**ï¼š
- Unixæ—¶é—´æˆ³ï¼ˆç§’/æ¯«ç§’ï¼‰
- ISO 8601æ ¼å¼
- è‡ªå®šä¹‰æ—¥æœŸæ ¼å¼

```properties
# æ—¶é—´æ ¼å¼è½¬æ¢
transforms=convertTime
transforms.convertTime.type=org.apache.kafka.connect.transforms.TimestampConverter$Value
transforms.convertTime.field=created_at
transforms.convertTime.target.type=string
transforms.convertTime.format=yyyy-MM-dd HH:mm:ss
```

**è½¬æ¢æ•ˆæœ**ï¼š
```
åŸå§‹ï¼šcreated_at: 1640995200000 (Unixæ¯«ç§’æ—¶é—´æˆ³)
è½¬æ¢åï¼šcreated_at: "2022-01-01 08:00:00"
```

---

## 4. ğŸ› ï¸ è‡ªå®šä¹‰è½¬æ¢å™¨å¼€å‘


### 4.1 ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰è½¬æ¢å™¨


**å†…ç½®è½¬æ¢å™¨æ— æ³•æ»¡è¶³çš„åœºæ™¯**ï¼š
- å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å¤„ç†
- ç‰¹æ®Šçš„æ•°æ®æ ¼å¼è½¬æ¢
- ä¸å¤–éƒ¨ç³»ç»Ÿçš„é›†æˆ
- ç‰¹å®šçš„ç®—æ³•è®¡ç®—

**è‡ªå®šä¹‰è½¬æ¢å™¨çš„ä¼˜åŠ¿**ï¼š
- ğŸ¯ **ç²¾ç¡®æ§åˆ¶**ï¼šå®Œå…¨æŒ‰ç…§ä¸šåŠ¡éœ€æ±‚è®¾è®¡
- ğŸ”§ **çµæ´»æ‰©å±•**ï¼šå¯ä»¥å®ç°ä»»æ„å¤æ‚çš„è½¬æ¢é€»è¾‘
- ğŸš€ **æ€§èƒ½ä¼˜åŒ–**ï¼šé’ˆå¯¹ç‰¹å®šåœºæ™¯è¿›è¡Œä¼˜åŒ–

### 4.2 å¼€å‘æ­¥éª¤è¯¦è§£


#### ç¬¬ä¸€æ­¥ï¼šå®ç°Transformationæ¥å£


```java
public class CustomerDataTransform implements Transformation<SinkRecord> {
    
    // é…ç½®å‚æ•°å®šä¹‰
    private static final ConfigDef CONFIG_DEF = new ConfigDef()
        .define("business.rule", ConfigDef.Type.STRING, 
                ConfigDef.Importance.HIGH, "ä¸šåŠ¡è§„åˆ™é…ç½®");
    
    private String businessRule;
    
    @Override
    public void configure(Map<String, ?> configs) {
        // è¯»å–é…ç½®å‚æ•°
        this.businessRule = (String) configs.get("business.rule");
    }
    
    @Override
    public SinkRecord apply(SinkRecord record) {
        // æ ¸å¿ƒè½¬æ¢é€»è¾‘
        Object value = record.value();
        Object transformedValue = performBusinessTransform(value);
        
        // åˆ›å»ºæ–°çš„record
        return record.newRecord(
            record.topic(),
            record.kafkaPartition(),
            record.keySchema(),
            record.key(),
            record.valueSchema(),
            transformedValue,
            record.timestamp()
        );
    }
    
    private Object performBusinessTransform(Object value) {
        // å…·ä½“çš„ä¸šåŠ¡è½¬æ¢é€»è¾‘
        // ä¾‹å¦‚ï¼šæ•°æ®è®¡ç®—ã€æ ¼å¼åŒ–ã€éªŒè¯ç­‰
        return value;
    }
}
```

#### ç¬¬äºŒæ­¥ï¼šé…ç½®å’Œéƒ¨ç½²


```properties
# ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢å™¨
transforms=customTransform
transforms.customTransform.type=com.company.kafka.transforms.CustomerDataTransform
transforms.customTransform.business.rule=rule1
```

### 4.3 å®æˆ˜æ¡ˆä¾‹ï¼šè®¢å•æ•°æ®å¤„ç†å™¨


**ä¸šåŠ¡éœ€æ±‚**ï¼š
å¯¹ç”µå•†è®¢å•æ•°æ®è¿›è¡Œä»¥ä¸‹å¤„ç†ï¼š
1. è®¡ç®—è®¢å•æ€»ä»·ï¼ˆå«ç¨ï¼‰
2. æ·»åŠ é£é™©è¯„ä¼°ç­‰çº§
3. æ ¼å¼åŒ–æ—¶é—´å­—æ®µ

```java
public class OrderDataProcessor implements Transformation<SinkRecord> {
    
    @Override
    public SinkRecord apply(SinkRecord record) {
        if (record.value() instanceof Map) {
            Map<String, Object> orderData = (Map<String, Object>) record.value();
            
            // 1. è®¡ç®—å«ç¨æ€»ä»·
            Double amount = (Double) orderData.get("amount");
            Double tax = (Double) orderData.get("tax_rate");
            orderData.put("total_amount", amount * (1 + tax));
            
            // 2. é£é™©è¯„ä¼°
            String riskLevel = calculateRiskLevel(orderData);
            orderData.put("risk_level", riskLevel);
            
            // 3. æ—¶é—´æ ¼å¼åŒ–
            Long timestamp = (Long) orderData.get("create_time");
            orderData.put("formatted_time", formatTimestamp(timestamp));
            
            return record.newRecord(
                record.topic(), record.kafkaPartition(),
                record.keySchema(), record.key(),
                record.valueSchema(), orderData,
                record.timestamp()
            );
        }
        return record;
    }
    
    private String calculateRiskLevel(Map<String, Object> orderData) {
        Double amount = (Double) orderData.get("total_amount");
        if (amount > 10000) return "HIGH";
        if (amount > 1000) return "MEDIUM";
        return "LOW";
    }
}
```

---

## 5. ğŸ“Š æ•°æ®å¤„ç†é«˜çº§åº”ç”¨


### 5.1 æ•°æ®æ˜ å°„ç­–ç•¥


**å­—æ®µæ˜ å°„è¡¨ç®¡ç†**ï¼š
```
æºç³»ç»Ÿå­—æ®µ     â†’    ç›®æ ‡ç³»ç»Ÿå­—æ®µ      â†’    è½¬æ¢è§„åˆ™
user_id       â†’    customer_id      â†’    ç›´æ¥æ˜ å°„
full_name     â†’    name             â†’    ç›´æ¥æ˜ å°„
birth_date    â†’    age              â†’    è®¡ç®—å¹´é¾„
phone_number  â†’    contact_phone    â†’    æ ¼å¼åŒ–å¤„ç†
```

**åŠ¨æ€æ˜ å°„é…ç½®**ï¼š
```properties
# æ”¯æŒå¤–éƒ¨é…ç½®æ–‡ä»¶çš„æ˜ å°„è§„åˆ™
transforms=dynamicMapping
transforms.dynamicMapping.type=com.company.DynamicFieldMapper
transforms.dynamicMapping.mapping.file=/config/field-mapping.json
transforms.dynamicMapping.reload.interval=300  # 5åˆ†é’Ÿé‡æ–°åŠ è½½
```

### 5.2 æ•°æ®è¿‡æ»¤æœºåˆ¶


**åŸºäºæ¡ä»¶çš„æ•°æ®è¿‡æ»¤**ï¼š
```
è¿‡æ»¤è§„åˆ™ç¤ºä¾‹ï¼š
âœ“ åªå¤„ç†çŠ¶æ€ä¸º"active"çš„ç”¨æˆ·æ•°æ®
âœ“ åªå¤„ç†é‡‘é¢å¤§äº100çš„è®¢å•
âœ“ è¿‡æ»¤æ‰æµ‹è¯•ç¯å¢ƒçš„æ•°æ®
âœ— ä¸¢å¼ƒæ ¼å¼ä¸æ­£ç¡®çš„æ•°æ®
```

**è¿‡æ»¤å™¨é…ç½®ç¤ºä¾‹**ï¼š
```properties
# è‡ªå®šä¹‰è¿‡æ»¤è½¬æ¢å™¨
transforms=dataFilter
transforms.dataFilter.type=com.company.ConditionalFilter
transforms.dataFilter.condition.field=status
transforms.dataFilter.condition.operator=equals
transforms.dataFilter.condition.value=active
transforms.dataFilter.action=keep  # keep or drop
```

### 5.3 æ•°æ®è·¯ç”±æ§åˆ¶


**æ™ºèƒ½è·¯ç”±ç­–ç•¥**ï¼š
```
è·¯ç”±è§„åˆ™ï¼š
è®¢å•æ•°æ® â†’ æ ¹æ®é‡‘é¢å¤§å°è·¯ç”±åˆ°ä¸åŒtopic
â”œâ”€â”€ å¤§é¢è®¢å•(>10000) â†’ high-value-orders
â”œâ”€â”€ ä¸­é¢è®¢å•(1000-10000) â†’ medium-orders
â””â”€â”€ å°é¢è®¢å•(<1000) â†’ regular-orders
```

**è·¯ç”±é…ç½®å®ç°**ï¼š
```properties
transforms=smartRouter
transforms.smartRouter.type=com.company.SmartTopicRouter
transforms.smartRouter.route.rules=amount:>10000:high-value-orders,amount:1000-10000:medium-orders,amount:<1000:regular-orders
```

### 5.4 æ•°æ®æ¸…æ´—æœ€ä½³å®è·µ


**æ¸…æ´—æ£€æŸ¥æ¸…å•**ï¼š
```
ğŸ” æ•°æ®è´¨é‡æ£€æŸ¥ï¼š
âœ“ å¿…å¡«å­—æ®µå®Œæ•´æ€§éªŒè¯
âœ“ æ•°æ®æ ¼å¼è§„èŒƒæ€§æ£€æŸ¥
âœ“ æ•°å€¼èŒƒå›´åˆç†æ€§éªŒè¯
âœ“ æ—¶é—´æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥

ğŸ§¹ æ•°æ®æ¸…ç†æ“ä½œï¼š
âœ“ å»é™¤å‰åç©ºæ ¼
âœ“ ç»Ÿä¸€å¤§å°å†™æ ¼å¼
âœ“ æ ‡å‡†åŒ–æ—¥æœŸæ—¶é—´æ ¼å¼
âœ“ å¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œç¼–ç 
```

---

## 6. âš™ï¸ è½¬æ¢é“¾é…ç½®ä¸ä¼˜åŒ–


### 6.1 è½¬æ¢é“¾è®¾è®¡åŸåˆ™


**æ‰§è¡Œé¡ºåºçš„é‡è¦æ€§**ï¼š
è½¬æ¢å™¨çš„æ‰§è¡Œé¡ºåºä¼šå½±å“æœ€ç»ˆç»“æœï¼Œéœ€è¦åˆç†è§„åˆ’ã€‚

```
æ­£ç¡®çš„è½¬æ¢é“¾é¡ºåºï¼š
1. æ•°æ®éªŒè¯å’Œæ¸…æ´—
2. å­—æ®µç±»å‹è½¬æ¢  
3. å­—æ®µé‡å‘½åå’Œæ˜ å°„
4. ä¸šåŠ¡é€»è¾‘å¤„ç†
5. æ•æ„Ÿæ•°æ®è„±æ•
6. æœ€ç»ˆæ ¼å¼åŒ–

é”™è¯¯ç¤ºä¾‹ï¼š
å¦‚æœå…ˆè„±æ•å†éªŒè¯ï¼Œå¯èƒ½å¯¼è‡´éªŒè¯å¤±è´¥
å¦‚æœå…ˆé‡å‘½åå†è½¬æ¢ï¼Œå¯èƒ½æ‰¾ä¸åˆ°åŸå­—æ®µ
```

### 6.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**è½¬æ¢æ€§èƒ½ç›‘æ§æŒ‡æ ‡**ï¼š
| æŒ‡æ ‡ç±»å‹ | ç›‘æ§é¡¹ç›® | æ­£å¸¸èŒƒå›´ | å¼‚å¸¸å¤„ç† |
|---------|---------|---------|---------|
| **å¤„ç†å»¶è¿Ÿ** | æ¯æ¡æ¶ˆæ¯è½¬æ¢æ—¶é—´ | `< 10ms` | ä¼˜åŒ–è½¬æ¢é€»è¾‘ |
| **ååé‡** | æ¯ç§’å¤„ç†æ¶ˆæ¯æ•° | `> 1000 msg/s` | å¢åŠ å¹¶è¡Œåº¦ |
| **é”™è¯¯ç‡** | è½¬æ¢å¤±è´¥æ¯”ä¾‹ | `< 0.1%` | æ£€æŸ¥æ•°æ®è´¨é‡ |
| **å†…å­˜ä½¿ç”¨** | è½¬æ¢å™¨å†…å­˜æ¶ˆè€— | `< 100MB` | ä¼˜åŒ–ç®—æ³•å®ç° |

**ä¼˜åŒ–æŠ€å·§**ï¼š
```
ğŸš€ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹ï¼š
1. é¿å…å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼
2. å‡å°‘ä¸å¿…è¦çš„å­—æ®µå¤åˆ¶
3. åˆå¹¶ç›¸ä¼¼çš„è½¬æ¢æ“ä½œ
4. ä½¿ç”¨ç¼“å­˜æé«˜æŸ¥æ‰¾æ•ˆç‡
5. å¼‚æ­¥å¤„ç†éå…³é”®è½¬æ¢
```

### 6.3 é”™è¯¯å¤„ç†å’Œå®¹é”™


**å®¹é”™æœºåˆ¶è®¾è®¡**ï¼š
```
é”™è¯¯å¤„ç†ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è½¬æ¢å¤±è´¥       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è®°å½•é”™è¯¯æ—¥å¿—  â”‚
â”‚ 2. å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ— â”‚
â”‚ 3. ç»§ç»­å¤„ç†ä¸‹ä¸€æ¡ â”‚
â”‚ 4. å®šæœŸé‡è¯•æœºåˆ¶  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é”™è¯¯å¤„ç†é…ç½®**ï¼š
```properties
# é”™è¯¯å®¹å¿é…ç½®
errors.tolerance=all  # none, all
errors.log.enable=true
errors.log.include.messages=true

# æ­»ä¿¡é˜Ÿåˆ—é…ç½®
errors.deadletterqueue.topic.name=failed-transforms
errors.deadletterqueue.context.headers.enable=true
```

### 6.4 ç›‘æ§å’Œè°ƒè¯•


**ç›‘æ§æŒ‡æ ‡é…ç½®**ï¼š
```properties
# JMXç›‘æ§å¯ç”¨
jmx=true

# è‡ªå®šä¹‰æŒ‡æ ‡
transforms.monitoring=enabled
transforms.debug.log.level=INFO
transforms.performance.metrics=true
```

**è°ƒè¯•æŠ€å·§**ï¼š
```
ğŸ” è°ƒè¯•æ–¹æ³•ï¼š
1. å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•
2. ä½¿ç”¨æµ‹è¯•æ•°æ®éªŒè¯è½¬æ¢ç»“æœ
3. ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
4. è®¾ç½®å‘Šè­¦é˜ˆå€¼
5. å®šæœŸæ£€æŸ¥é”™è¯¯æ—¥å¿—
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•°æ®è½¬æ¢æœ¬è´¨ï¼šåœ¨æ•°æ®æµåŠ¨è¿‡ç¨‹ä¸­è¿›è¡Œæ ¼å¼è°ƒæ•´å’Œå†…å®¹ä¿®æ”¹
ğŸ”¸ SMTæœºåˆ¶ï¼šSingle Message Transformsï¼Œå¯¹å•æ¡æ¶ˆæ¯è¿›è¡Œè½¬æ¢
ğŸ”¸ è½¬æ¢ä½ç½®ï¼šSourceç«¯è½¬æ¢å’ŒSinkç«¯è½¬æ¢
ğŸ”¸ å†…ç½®è½¬æ¢å™¨ï¼šå­—æ®µæ“ä½œã€å†…å®¹ä¿®æ”¹ã€ç»“æ„è°ƒæ•´ã€æ—¶é—´å¤„ç†å››å¤§ç±»
ğŸ”¸ è‡ªå®šä¹‰å¼€å‘ï¼šå®ç°Transformationæ¥å£ï¼Œæ»¡è¶³ç‰¹æ®Šä¸šåŠ¡éœ€æ±‚
ğŸ”¸ è½¬æ¢é“¾é…ç½®ï¼šå¤šä¸ªè½¬æ¢å™¨æŒ‰é¡ºåºæ‰§è¡Œï¼Œéœ€è¦åˆç†è§„åˆ’é¡ºåº
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è½¬æ¢**
```
å®é™…éœ€æ±‚ï¼š
- ä¸åŒç³»ç»Ÿçš„æ•°æ®æ ¼å¼å·®å¼‚
- ä¸šåŠ¡è§„åˆ™çš„ç‰¹æ®Šè¦æ±‚
- æ•°æ®è´¨é‡å’Œå®‰å…¨è¦æ±‚
- ç³»ç»Ÿé—´çš„é€‚é…éœ€è¦
```

**ğŸ”¹ è½¬æ¢å™¨é€‰æ‹©åŸåˆ™**
```
é€‰æ‹©æ ‡å‡†ï¼š
- ç®€å•éœ€æ±‚ä¼˜å…ˆä½¿ç”¨å†…ç½®è½¬æ¢å™¨
- å¤æ‚ä¸šåŠ¡é€»è¾‘è€ƒè™‘è‡ªå®šä¹‰å¼€å‘
- æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯éœ€è¦ä¼˜åŒ–
- å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§çš„å¹³è¡¡
```

**ğŸ”¹ æ€§èƒ½å’Œå¯é æ€§å¹³è¡¡**
```
å…³é”®è¦ç´ ï¼š
- è½¬æ¢é€»è¾‘çš„å¤æ‚åº¦æ§åˆ¶
- é”™è¯¯å¤„ç†å’Œå®¹é”™æœºåˆ¶
- ç›‘æ§å’Œè°ƒè¯•èƒ½åŠ›
- èµ„æºæ¶ˆè€—çš„åˆç†æ§åˆ¶
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**æœ€ä½³å®è·µæ¸…å•**ï¼š
```
âœ… è®¾è®¡é˜¶æ®µï¼š
- æ˜ç¡®è½¬æ¢éœ€æ±‚å’Œç›®æ ‡
- é€‰æ‹©åˆé€‚çš„è½¬æ¢å™¨ç±»å‹
- è§„åˆ’è½¬æ¢é“¾çš„æ‰§è¡Œé¡ºåº
- è€ƒè™‘æ€§èƒ½å’Œå®¹é”™éœ€æ±‚

âœ… å¼€å‘é˜¶æ®µï¼š
- å……åˆ†æµ‹è¯•è½¬æ¢é€»è¾‘
- æ·»åŠ å¿…è¦çš„æ—¥å¿—è®°å½•
- å®ç°é”™è¯¯å¤„ç†æœºåˆ¶
- ä¼˜åŒ–æ€§èƒ½å…³é”®è·¯å¾„

âœ… è¿ç»´é˜¶æ®µï¼š
- ç›‘æ§è½¬æ¢æ€§èƒ½æŒ‡æ ‡
- å®šæœŸæ£€æŸ¥é”™è¯¯æ—¥å¿—
- æ ¹æ®ä¸šåŠ¡å˜åŒ–è°ƒæ•´é…ç½®
- ç»´æŠ¤å’Œæ›´æ–°è½¬æ¢é€»è¾‘
```

**å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**ï¼š
| é—®é¢˜ç±»å‹ | å¸¸è§åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| **è½¬æ¢å¤±è´¥** | æ•°æ®æ ¼å¼ä¸åŒ¹é… | å¢åŠ æ•°æ®éªŒè¯å’Œæ ¼å¼åŒ– |
| **æ€§èƒ½ä¸‹é™** | è½¬æ¢é€»è¾‘å¤æ‚ | ä¼˜åŒ–ç®—æ³•æˆ–ç®€åŒ–é€»è¾‘ |
| **å†…å­˜æº¢å‡º** | å¤„ç†å¤§é‡æ•°æ® | å¢åŠ å†…å­˜æˆ–ä¼˜åŒ–å†…å­˜ä½¿ç”¨ |
| **æ•°æ®ä¸¢å¤±** | é”™è¯¯å¤„ç†ä¸å½“ | å®Œå–„å®¹é”™æœºåˆ¶å’Œç›‘æ§ |

### 7.4 å­¦ä¹ å»ºè®®


**å­¦ä¹ è·¯å¾„**ï¼š
```
1. ç†è§£æ•°æ®è½¬æ¢çš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨
2. ç†Ÿç»ƒæŒæ¡å¸¸ç”¨å†…ç½®è½¬æ¢å™¨çš„ä½¿ç”¨
3. å­¦ä¼šé…ç½®å’Œè°ƒè¯•è½¬æ¢é“¾
4. å°è¯•å¼€å‘ç®€å•çš„è‡ªå®šä¹‰è½¬æ¢å™¨
5. æ·±å…¥äº†è§£æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†
6. ç»“åˆå®é™…é¡¹ç›®è¿›è¡Œå®è·µåº”ç”¨
```

**å®è·µå»ºè®®**ï¼š
- ä»ç®€å•çš„å­—æ®µé‡å‘½åå¼€å§‹ç»ƒä¹ 
- é€æ­¥å°è¯•å¤æ‚çš„æ•°æ®å¤„ç†åœºæ™¯
- å¤šå…³æ³¨æ€§èƒ½ç›‘æ§å’Œé”™è¯¯å¤„ç†
- ç§¯ç´¯å¸¸ç”¨è½¬æ¢æ¨¡å¼çš„é…ç½®æ¨¡æ¿

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ•°æ®è½¬æ¢æ˜¯è¿æ¥å¼‚æ„ç³»ç»Ÿçš„æ¡¥æ¢
- SMTæä¾›äº†çµæ´»çš„å•æ¶ˆæ¯å¤„ç†èƒ½åŠ›
- å†…ç½®è½¬æ¢å™¨è¦†ç›–å¤§å¤šæ•°å¸¸è§éœ€æ±‚
- è‡ªå®šä¹‰è½¬æ¢å™¨è§£å†³ç‰¹æ®Šä¸šåŠ¡åœºæ™¯
- æ€§èƒ½å’Œå¯é æ€§éœ€è¦æŒç»­å…³æ³¨å’Œä¼˜åŒ–