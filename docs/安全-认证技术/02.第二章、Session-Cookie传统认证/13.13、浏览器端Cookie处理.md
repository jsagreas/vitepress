---
title: 13ã€æµè§ˆå™¨ç«¯Cookieå¤„ç†
---
## ğŸ“š ç›®å½•

1. [CookieåŸºç¡€æ¦‚å¿µå›é¡¾](#1-CookieåŸºç¡€æ¦‚å¿µå›é¡¾)
2. [æµè§ˆå™¨å¦‚ä½•è‡ªåŠ¨å¤„ç†Cookie](#2-æµè§ˆå™¨å¦‚ä½•è‡ªåŠ¨å¤„ç†Cookie)
3. [JavaScriptè¯»å–Cookieæ–¹æ³•](#3-JavaScriptè¯»å–Cookieæ–¹æ³•)
4. [JavaScriptè®¾ç½®Cookieæ–¹æ³•](#4-JavaScriptè®¾ç½®Cookieæ–¹æ³•)
5. [Cookieåœ¨ä¸åŒé¡µé¢é—´çš„å…±äº«](#5-Cookieåœ¨ä¸åŒé¡µé¢é—´çš„å…±äº«)
6. [ç§»åŠ¨ç«¯é€‚é…é—®é¢˜](#6-ç§»åŠ¨ç«¯é€‚é…é—®é¢˜)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸª CookieåŸºç¡€æ¦‚å¿µå›é¡¾


### 1.1 ä»€ä¹ˆæ˜¯Cookieï¼Ÿ

**é€šä¿—ç†è§£**ï¼šCookieå°±åƒæ˜¯ç½‘ç«™ç»™ä½ å‘çš„ä¸€å¼ "ä¼šå‘˜å¡"ï¼Œä¸Šé¢è®°å½•äº†ä¸€äº›ä¿¡æ¯ï¼Œæ¯æ¬¡ä½ è®¿é—®è¿™ä¸ªç½‘ç«™æ—¶éƒ½ä¼šè‡ªåŠ¨å‡ºç¤ºè¿™å¼ å¡ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
ğŸª å•†åº—ï¼šç»™é¡¾å®¢å‘ä¼šå‘˜å¡ï¼Œè®°å½•ç§¯åˆ†ã€åå¥½
ğŸŒ ç½‘ç«™ï¼šç»™æµè§ˆå™¨å‘Cookieï¼Œè®°å½•ç™»å½•çŠ¶æ€ã€è®¾ç½®

Cookieå­˜å‚¨ä½ç½®ï¼š
æµè§ˆå™¨ â†’ æœ¬åœ°å­˜å‚¨ â†’ ç‰¹å®šç½‘ç«™çš„Cookieæ–‡ä»¶å¤¹
```

### 1.2 Session-Cookieè®¤è¯æœºåˆ¶ç®€è¿°

**åŸºæœ¬æµç¨‹**ï¼š
```
ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨åˆ›å»ºSession â†’ å‘é€SessionIDç»™æµè§ˆå™¨ 
â†’ æµè§ˆå™¨ä¿å­˜ä¸ºCookie â†’ åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦Cookie
```

**ğŸ’¡ å…³é”®ç†è§£**ï¼š
- **Session**ï¼šæœåŠ¡å™¨ç«¯å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„"æ¡£æ¡ˆæŸœ"
- **Cookie**ï¼šæµè§ˆå™¨ç«¯å­˜å‚¨çš„"é’¥åŒ™"ï¼Œç”¨æ¥æ‰¾åˆ°å¯¹åº”çš„Session
- **SessionID**ï¼šè¿™æŠŠ"é’¥åŒ™"ä¸Šçš„ç¼–å·

---

## 2. ğŸ”„ æµè§ˆå™¨å¦‚ä½•è‡ªåŠ¨å¤„ç†Cookie


### 2.1 æµè§ˆå™¨çš„Cookieç®¡å®¶æœºåˆ¶

æµè§ˆå™¨å°±åƒä¸€ä¸ª**è´´å¿ƒçš„ç®¡å®¶**ï¼Œä¼šè‡ªåŠ¨å¸®ä½ ç®¡ç†æ‰€æœ‰ç½‘ç«™çš„Cookieï¼š

```
æµè§ˆå™¨çš„è‡ªåŠ¨åŒ–å·¥ä½œï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æ¥æ”¶ï¼šæœåŠ¡å™¨å‘é€Set-Cookieå“åº”å¤´   â”‚
â”‚  ğŸ’¾ å­˜å‚¨ï¼šæŒ‰åŸŸååˆ†ç±»ä¿å­˜åˆ°æœ¬åœ°        â”‚
â”‚  ğŸ“¤ å‘é€ï¼šåŒ¹é…çš„è¯·æ±‚è‡ªåŠ¨æºå¸¦Cookie    â”‚
â”‚  ğŸ—‘ï¸ æ¸…ç†ï¼šè¿‡æœŸCookieè‡ªåŠ¨åˆ é™¤         â”‚
â”‚  ğŸ”’ ä¿æŠ¤ï¼šæŒ‰å®‰å…¨ç­–ç•¥æ§åˆ¶è®¿é—®          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Cookieçš„æ¥æ”¶è¿‡ç¨‹

**æœåŠ¡å™¨å‘é€Cookie**ï¼š
```http
HTTP/1.1 200 OK
Set-Cookie: sessionId=abc123; Path=/; HttpOnly
Set-Cookie: username=john; Path=/; Max-Age=3600
Content-Type: text/html
```

**æµè§ˆå™¨è‡ªåŠ¨å¤„ç†**ï¼š
1. **è§£æ**ï¼šè¯»å–`Set-Cookie`å“åº”å¤´
2. **éªŒè¯**ï¼šæ£€æŸ¥åŸŸåã€è·¯å¾„æ˜¯å¦åˆæ³•
3. **å­˜å‚¨**ï¼šä¿å­˜åˆ°å¯¹åº”åŸŸåçš„Cookieå­˜å‚¨åŒº
4. **åˆ†ç±»**ï¼šæŒ‰åŸŸåã€è·¯å¾„ç»„ç»‡ç®¡ç†

### 2.3 Cookieçš„å‘é€è¿‡ç¨‹

**æµè§ˆå™¨å‘é€è¯·æ±‚æ—¶**ï¼š
```http
GET /dashboard HTTP/1.1
Host: example.com
Cookie: sessionId=abc123; username=john
```

**è‡ªåŠ¨åŒ¹é…è§„åˆ™**ï¼š
```
ğŸ¯ åŸŸååŒ¹é…ï¼šåªå‘é€å½“å‰åŸŸåçš„Cookie
ğŸ“ è·¯å¾„åŒ¹é…ï¼šåªå‘é€è·¯å¾„åŒ¹é…çš„Cookie  
â° æ—¶é—´æœ‰æ•ˆï¼šåªå‘é€æœªè¿‡æœŸçš„Cookie
ğŸ”’ å®‰å…¨ç­–ç•¥ï¼šéµå®ˆSecureã€SameSiteç­‰é™åˆ¶
```

### 2.4 æµè§ˆå™¨Cookieå­˜å‚¨ç»“æ„

```
æµè§ˆå™¨Cookieå­˜å‚¨ç¤ºæ„ï¼š
ğŸ“‚ Chrome Cookieå­˜å‚¨
â”œâ”€â”€ ğŸ“ example.com
â”‚   â”œâ”€â”€ sessionId=abc123 (HttpOnly, Secure)
â”‚   â”œâ”€â”€ username=john (æ™®é€šCookie)
â”‚   â””â”€â”€ preferences=dark-theme (æŒä¹…Cookie)
â”œâ”€â”€ ğŸ“ google.com  
â”‚   â””â”€â”€ auth_token=xyz789
â””â”€â”€ ğŸ“ github.com
    â””â”€â”€ logged_in=yes
```

---

## 3. ğŸ“– JavaScriptè¯»å–Cookieæ–¹æ³•


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦JavaScriptè¯»å–Cookieï¼Ÿ

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
- ğŸ¨ **å‰ç«¯ä¸ªæ€§åŒ–**ï¼šæ ¹æ®ç”¨æˆ·è®¾ç½®è°ƒæ•´ç•Œé¢ä¸»é¢˜
- ğŸ” **çŠ¶æ€æ£€æŸ¥**ï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
- ğŸ“Š **æ•°æ®åˆ†æ**ï¼šè¯»å–ç”¨æˆ·è¡Œä¸ºåå¥½
- ğŸš€ **å•é¡µåº”ç”¨**ï¼šå‰ç«¯è·¯ç”±æƒé™æ§åˆ¶

### 3.2 document.cookieåŸºç¡€ç”¨æ³•

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
// è¯»å–æ‰€æœ‰Cookieï¼ˆè¿”å›å­—ç¬¦ä¸²ï¼‰
const allCookies = document.cookie;
console.log(allCookies); 
// è¾“å‡ºï¼šsessionId=abc123; username=john; theme=dark
```

**âš ï¸ é‡è¦ç†è§£**ï¼š
- `document.cookie`è¿”å›çš„æ˜¯**å­—ç¬¦ä¸²**ï¼Œä¸æ˜¯å¯¹è±¡
- å¤šä¸ªCookieç”¨**åˆ†å·å’Œç©ºæ ¼**åˆ†éš”
- éœ€è¦**æ‰‹åŠ¨è§£æ**æ‰èƒ½è·å–å…·ä½“å€¼

### 3.3 è§£æCookieçš„å®ç”¨å‡½æ•°

```javascript
// ğŸ”§ é€šç”¨Cookieè¯»å–å‡½æ•°
function getCookie(name) {
    // åœ¨Cookieå­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾æŒ‡å®šåç§°
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    
    if (parts.length === 2) {
        return parts.pop().split(';').shift();
    }
    return null; // Cookieä¸å­˜åœ¨æ—¶è¿”å›null
}

// ğŸ“ ä½¿ç”¨ç¤ºä¾‹
const sessionId = getCookie('sessionId');
if (sessionId) {
    console.log('ç”¨æˆ·å·²ç™»å½•ï¼ŒSessionID:', sessionId);
} else {
    console.log('ç”¨æˆ·æœªç™»å½•');
}
```

### 3.4 æ‰¹é‡è§£æCookieçš„é«˜çº§æ–¹æ³•

```javascript
// ğŸ¯ è§£ææ‰€æœ‰Cookieä¸ºå¯¹è±¡
function parseCookies() {
    return document.cookie
        .split(';')                    // æŒ‰åˆ†å·åˆ†å‰²
        .map(cookie => cookie.trim())  // å»é™¤ç©ºæ ¼
        .reduce((cookies, cookie) => {
            const [name, value] = cookie.split('=');
            if (name && value) {
                cookies[name] = decodeURIComponent(value);
            }
            return cookies;
        }, {});
}

// ä½¿ç”¨ç¤ºä¾‹
const cookies = parseCookies();
console.log(cookies);
// è¾“å‡ºï¼š{ sessionId: "abc123", username: "john", theme: "dark" }
```

### 3.5 HttpOnlyé™åˆ¶è¯´æ˜

```javascript
// âŒ æ— æ³•è¯»å–HttpOnly Cookie
const sessionId = getCookie('sessionId'); // å¯èƒ½è¿”å›null

/*
ğŸ”’ å®‰å…¨è¯´æ˜ï¼š
- HttpOnly Cookieï¼šåªèƒ½è¢«æœåŠ¡å™¨è®¿é—®ï¼ŒJavaScriptæ— æ³•è¯»å–
- æ™®é€šCookieï¼šJavaScriptå¯ä»¥è‡ªç”±è¯»å–å’Œä¿®æ”¹
- è¿™æ˜¯ä¸ºäº†é˜²æ­¢XSSæ”»å‡»çªƒå–æ•æ„Ÿä¿¡æ¯
*/
```

---

## 4. âœï¸ JavaScriptè®¾ç½®Cookieæ–¹æ³•


### 4.1 åŸºç¡€è®¾ç½®è¯­æ³•

```javascript
// æœ€ç®€å•çš„Cookieè®¾ç½®
document.cookie = "username=john";

// è®¾ç½®å¸¦è¿‡æœŸæ—¶é—´çš„Cookie
document.cookie = "theme=dark; max-age=3600"; // 1å°æ—¶åè¿‡æœŸ

// è®¾ç½®è·¯å¾„å’ŒåŸŸå
document.cookie = "language=zh; path=/; domain=.example.com";
```

### 4.2 å®ç”¨çš„Cookieè®¾ç½®å‡½æ•°

```javascript
// ğŸ› ï¸ é€šç”¨Cookieè®¾ç½®å‡½æ•°
function setCookie(name, value, options = {}) {
    let cookieString = `${name}=${encodeURIComponent(value)}`;
    
    // è®¾ç½®è¿‡æœŸæ—¶é—´
    if (options.maxAge) {
        cookieString += `; max-age=${options.maxAge}`;
    }
    
    // è®¾ç½®è·¯å¾„
    if (options.path) {
        cookieString += `; path=${options.path}`;
    }
    
    // è®¾ç½®åŸŸå
    if (options.domain) {
        cookieString += `; domain=${options.domain}`;
    }
    
    // è®¾ç½®å®‰å…¨æ ‡å¿—
    if (options.secure) {
        cookieString += '; secure';
    }
    
    document.cookie = cookieString;
}

// ğŸ“ ä½¿ç”¨ç¤ºä¾‹
setCookie('userPreference', 'darkTheme', {
    maxAge: 30 * 24 * 3600, // 30å¤©
    path: '/',
    secure: true
});
```

### 4.3 å¸¸ç”¨Cookieæ“ä½œå°è£…

```javascript
// ğŸ¯ å®Œæ•´çš„Cookieå·¥å…·ç±»
class CookieManager {
    // è®¾ç½®Cookie
    static set(name, value, days = 7) {
        const expires = new Date();
        expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
        
        document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires.toUTCString()}; path=/`;
    }
    
    // è·å–Cookie
    static get(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) {
            return decodeURIComponent(parts.pop().split(';').shift());
        }
        return null;
    }
    
    // åˆ é™¤Cookie
    static remove(name) {
        document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
    }
    
    // æ£€æŸ¥Cookieæ˜¯å¦å­˜åœ¨
    static exists(name) {
        return this.get(name) !== null;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
CookieManager.set('userId', '12345', 30); // ä¿å­˜30å¤©
const userId = CookieManager.get('userId');
CookieManager.remove('userId'); // åˆ é™¤Cookie
```

### 4.4 ç‰¹æ®Šå­—ç¬¦å¤„ç†

```javascript
// ğŸ”„ å¤„ç†ç‰¹æ®Šå­—ç¬¦çš„Cookie
function setSecureCookie(name, value) {
    // encodeURIComponentç¡®ä¿ç‰¹æ®Šå­—ç¬¦æ­£ç¡®ç¼–ç 
    const encodedValue = encodeURIComponent(value);
    document.cookie = `${name}=${encodedValue}; path=/`;
}

// ç¤ºä¾‹ï¼šä¿å­˜åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ•°æ®
setSecureCookie('userInfo', 'ç”¨æˆ·åï¼šå¼ ä¸‰; é‚®ç®±ï¼štest@example.com');
```

---

## 5. ğŸ”— Cookieåœ¨ä¸åŒé¡µé¢é—´çš„å…±äº«


### 5.1 åŒåŸŸåé¡µé¢å…±äº«

**åŸºæœ¬åŸç†**ï¼šåŒä¸€ä¸ªåŸŸåä¸‹çš„æ‰€æœ‰é¡µé¢é»˜è®¤å¯ä»¥å…±äº«Cookie

```
ç½‘ç«™ç»“æ„ç¤ºä¾‹ï¼š
https://example.com
â”œâ”€â”€ ğŸ“„ /index.html     â† é¦–é¡µ
â”œâ”€â”€ ğŸ“„ /login.html     â† ç™»å½•é¡µ
â”œâ”€â”€ ğŸ“„ /dashboard.html â† ä»ªè¡¨æ¿
â””â”€â”€ ğŸ“ /user/
    â””â”€â”€ ğŸ“„ profile.html â† ç”¨æˆ·èµ„æ–™

ğŸ’¡ å…±äº«è§„åˆ™ï¼š
- æ‰€æœ‰é¡µé¢éƒ½èƒ½è®¿é—® path=/ çš„Cookie
- /user/profile.html è¿˜èƒ½è®¿é—® path=/user/ çš„Cookie
```

### 5.2 è·¯å¾„æ§åˆ¶å…±äº«èŒƒå›´

```javascript
// ğŸ¯ ä¸åŒè·¯å¾„çš„Cookieè®¾ç½®
// å…¨ç«™å¯è®¿é—®çš„Cookie
document.cookie = "siteTheme=dark; path=/";

// åªæœ‰ç”¨æˆ·ç›¸å…³é¡µé¢å¯è®¿é—®
document.cookie = "userSettings=advanced; path=/user/";

// åªæœ‰ç®¡ç†å‘˜é¡µé¢å¯è®¿é—®  
document.cookie = "adminToken=xyz123; path=/admin/";
```

**è®¿é—®æƒé™ç¤ºä¾‹**ï¼š
```
é¡µé¢è·¯å¾„              å¯è®¿é—®çš„Cookie
/index.html          siteTheme
/user/profile.html   siteTheme + userSettings  
/admin/dashboard.html siteTheme + adminToken
```

### 5.3 å­åŸŸåå…±äº«ç­–ç•¥

```javascript
// ğŸŒ è·¨å­åŸŸåå…±äº«Cookie
// åœ¨ www.example.com è®¾ç½®
document.cookie = "globalUser=john; domain=.example.com; path=/";

// ä»¥ä¸‹åŸŸåéƒ½å¯ä»¥è®¿é—®ï¼š
// - www.example.com  
// - api.example.com
// - admin.example.com
```

### 5.4 é¡µé¢é—´æ•°æ®åŒæ­¥å®æˆ˜

```javascript
// ğŸ’¼ å®é™…åº”ç”¨ï¼šè´­ç‰©è½¦æ•°æ®åŒæ­¥
class ShoppingCart {
    static addItem(productId, quantity) {
        const cart = this.getCart();
        cart[productId] = (cart[productId] || 0) + quantity;
        this.saveCart(cart);
    }
    
    static getCart() {
        const cartData = CookieManager.get('shoppingCart');
        return cartData ? JSON.parse(cartData) : {};
    }
    
    static saveCart(cart) {
        // ä¿å­˜åˆ°Cookieï¼Œæ‰€æœ‰é¡µé¢éƒ½èƒ½è®¿é—®
        CookieManager.set('shoppingCart', JSON.stringify(cart), 7);
    }
    
    static getItemCount() {
        const cart = this.getCart();
        return Object.values(cart).reduce((sum, qty) => sum + qty, 0);
    }
}

// åœ¨ä»»ä½•é¡µé¢ä½¿ç”¨
ShoppingCart.addItem('product123', 2);
console.log('è´­ç‰©è½¦å•†å“æ•°é‡:', ShoppingCart.getItemCount());
```

---

## 6. ğŸ“± ç§»åŠ¨ç«¯é€‚é…é—®é¢˜


### 6.1 ç§»åŠ¨ç«¯Cookieç‰¹æ®Šæ€§

**ä¸»è¦å·®å¼‚**ï¼š
```
æ¡Œé¢æµè§ˆå™¨ vs ç§»åŠ¨ç«¯æµè§ˆå™¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¡Œé¢ç«¯ç‰¹ç‚¹     â”‚   ç§»åŠ¨ç«¯ç‰¹ç‚¹     â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Cookieå­˜å‚¨ç¨³å®š  â”‚ å¯èƒ½è¢«ç³»ç»Ÿæ¸…ç†   â”‚
â”‚ é•¿æœŸä¿æŒç™»å½•    â”‚ åº”ç”¨åˆ‡æ¢æ—¶æ¸…ç†   â”‚
â”‚ å¤šæ ‡ç­¾é¡µå…±äº«    â”‚ æµè§ˆå™¨ç‹¬ç«‹è¿›ç¨‹   â”‚
â”‚ å­˜å‚¨ç©ºé—´å……è¶³    â”‚ å­˜å‚¨ç©ºé—´æœ‰é™     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 iOS Safariç‰¹æ®Šé™åˆ¶

```javascript
// ğŸ iOS Safariçš„Cookieé™åˆ¶
/*
ä¸»è¦é—®é¢˜ï¼š
1. éšç§æ¨¡å¼ä¸‹Cookieå¤±æ•ˆ
2. è·¨ç«™ç‚¹Cookieè¢«é˜»æ­¢  
3. ç¬¬ä¸‰æ–¹Cookieé»˜è®¤ç¦ç”¨
4. ITPï¼ˆæ™ºèƒ½é˜²è·Ÿè¸ªï¼‰å½±å“Cookieç”Ÿå‘½å‘¨æœŸ
*/

// æ£€æµ‹iOS Safari
function isIOSSafari() {
    const ua = navigator.userAgent;
    return /iPad|iPhone|iPod/.test(ua) && /Safari/.test(ua) && !/Chrome/.test(ua);
}

// iOSé€‚é…æ–¹æ¡ˆ
if (isIOSSafari()) {
    // ä½¿ç”¨æ›´çŸ­çš„Cookieæœ‰æ•ˆæœŸ
    setCookie('userToken', token, { maxAge: 7200 }); // 2å°æ—¶
} else {
    // å…¶ä»–æµè§ˆå™¨ä½¿ç”¨æ­£å¸¸æœ‰æ•ˆæœŸ
    setCookie('userToken', token, { maxAge: 86400 }); // 24å°æ—¶
}
```

### 6.3 Android WebViewå…¼å®¹æ€§

```javascript
// ğŸ¤– Android WebView Cookieå¤„ç†
/*
å¸¸è§é—®é¢˜ï¼š
1. WebViewç‰ˆæœ¬å·®å¼‚å¯¼è‡´Cookieè¡Œä¸ºä¸ä¸€è‡´
2. åº”ç”¨å†…åµŒé¡µé¢Cookieä¸¢å¤±
3. åŸç”Ÿåº”ç”¨ä¸WebView Cookieä¸åŒæ­¥
*/

// WebViewç¯å¢ƒæ£€æµ‹
function isWebView() {
    const ua = navigator.userAgent;
    return /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)|Android.*(wv|\.0\.0\.0)/i.test(ua);
}

// WebViewé€‚é…ç­–ç•¥
class MobileAuthManager {
    static saveLoginState(userInfo) {
        if (isWebView()) {
            // WebViewç¯å¢ƒï¼šä½¿ç”¨LocalStorageå¤‡ä»½
            localStorage.setItem('userInfo', JSON.stringify(userInfo));
            localStorage.setItem('loginTime', Date.now().toString());
        }
        
        // åŒæ—¶è®¾ç½®Cookie
        setCookie('authToken', userInfo.token, { maxAge: 3600 });
    }
    
    static getLoginState() {
        // ä¼˜å…ˆä»Cookieè¯»å–
        let token = getCookie('authToken');
        
        if (!token && isWebView()) {
            // Cookieå¤±æ•ˆæ—¶ä»LocalStorageæ¢å¤
            const userInfo = localStorage.getItem('userInfo');
            const loginTime = localStorage.getItem('loginTime');
            
            if (userInfo && loginTime) {
                const timeDiff = Date.now() - parseInt(loginTime);
                if (timeDiff < 3600000) { // 1å°æ—¶å†…æœ‰æ•ˆ
                    const parsed = JSON.parse(userInfo);
                    token = parsed.token;
                    // é‡æ–°è®¾ç½®Cookie
                    setCookie('authToken', token, { maxAge: 3600 });
                }
            }
        }
        
        return token;
    }
}
```

### 6.4 è·¨åŸŸå’ŒSameSiteé—®é¢˜

```javascript
// ğŸ”’ SameSiteå±æ€§ç§»åŠ¨ç«¯å¤„ç†
/*
SameSiteå–å€¼ï¼š
- Strictï¼šæœ€ä¸¥æ ¼ï¼Œè·¨ç«™ç‚¹è¯·æ±‚ä¸å‘é€Cookie
- Laxï¼šä¸­ç­‰ä¸¥æ ¼ï¼ŒGETè¯·æ±‚ä¼šå‘é€Cookie  
- Noneï¼šæœ€å®½æ¾ï¼Œéœ€è¦é…åˆSecureä½¿ç”¨
*/

// ç§»åŠ¨ç«¯å‹å¥½çš„Cookieè®¾ç½®
function setMobileFriendlyCookie(name, value, options = {}) {
    let cookieString = `${name}=${encodeURIComponent(value)}`;
    
    // ç§»åŠ¨ç«¯æ¨èè®¾ç½®
    cookieString += '; SameSite=Lax';  // å…¼å®¹æ€§æœ€å¥½
    cookieString += '; Secure';        // HTTPSå¿…éœ€
    
    if (options.maxAge) {
        cookieString += `; max-age=${options.maxAge}`;
    }
    
    document.cookie = cookieString;
}
```

### 6.5 ç§»åŠ¨ç«¯å­˜å‚¨æ›¿ä»£æ–¹æ¡ˆ

```javascript
// ğŸ“± ç§»åŠ¨ç«¯æ··åˆå­˜å‚¨ç­–ç•¥
class MobileStorageManager {
    static setItem(key, value, ttl = 3600) {
        const item = {
            value: value,
            timestamp: Date.now(),
            ttl: ttl * 1000
        };
        
        try {
            // æ–¹æ¡ˆ1ï¼šä¼˜å…ˆä½¿ç”¨Cookie
            setCookie(key, JSON.stringify(item), { maxAge: ttl });
        } catch (e) {
            // æ–¹æ¡ˆ2ï¼šCookieå¤±è´¥æ—¶ä½¿ç”¨LocalStorage
            localStorage.setItem(key, JSON.stringify(item));
        }
    }
    
    static getItem(key) {
        let itemStr = getCookie(key);
        
        if (!itemStr) {
            // Cookieä¸å­˜åœ¨æ—¶å°è¯•LocalStorage
            itemStr = localStorage.getItem(key);
        }
        
        if (!itemStr) return null;
        
        try {
            const item = JSON.parse(itemStr);
            const now = Date.now();
            
            // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
            if (now - item.timestamp > item.ttl) {
                this.removeItem(key);
                return null;
            }
            
            return item.value;
        } catch (e) {
            return null;
        }
    }
    
    static removeItem(key) {
        // åŒæ—¶æ¸…ç†Cookieå’ŒLocalStorage
        document.cookie = `${key}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
        localStorage.removeItem(key);
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

```
ğŸ”¸ æµè§ˆå™¨Cookieè‡ªåŠ¨åŒ–ï¼šæ¥æ”¶ã€å­˜å‚¨ã€å‘é€ã€æ¸…ç†å…¨è‡ªåŠ¨
ğŸ”¸ JavaScriptæ“ä½œï¼šdocument.cookieè¯»å†™ï¼Œéœ€è¦æ‰‹åŠ¨è§£æ
ğŸ”¸ é¡µé¢é—´å…±äº«ï¼šåŒåŸŸåè‡ªåŠ¨å…±äº«ï¼Œè·¯å¾„å’ŒåŸŸåæ§åˆ¶èŒƒå›´
ğŸ”¸ ç§»åŠ¨ç«¯å·®å¼‚ï¼šå­˜å‚¨ä¸ç¨³å®šï¼Œéœ€è¦å¤‡ç”¨æ–¹æ¡ˆ
ğŸ”¸ å®‰å…¨é™åˆ¶ï¼šHttpOnlyã€SameSiteã€Secureç­‰ä¿æŠ¤æœºåˆ¶
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æµè§ˆå™¨æ˜¯Cookieç®¡å®¶**
```
ç†è§£é‡ç‚¹ï¼š
- æµè§ˆå™¨è‡ªåŠ¨å¤„ç†Cookieçš„æ¥æ”¶ã€å­˜å‚¨ã€å‘é€
- å¼€å‘è€…åªéœ€è¦è®¾ç½®ï¼Œä¸ç”¨æ‹…å¿ƒå‘é€é€»è¾‘
- éµå¾ªåŸŸåã€è·¯å¾„ã€æ—¶é—´ç­‰åŒ¹é…è§„åˆ™
```

**ğŸ”¹ JavaScriptæ“ä½œçš„å±€é™æ€§**
```
é‡è¦è®¤çŸ¥ï¼š
- document.cookieè¿”å›å­—ç¬¦ä¸²ï¼Œéœ€è¦è§£æ
- æ— æ³•è¯»å–HttpOnly Cookieï¼ˆå®‰å…¨é™åˆ¶ï¼‰
- è®¾ç½®æ—¶è¦è€ƒè™‘ç¼–ç å’Œç‰¹æ®Šå­—ç¬¦
- åˆ é™¤å®é™…æ˜¯è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºè¿‡å»
```

**ğŸ”¹ ç§»åŠ¨ç«¯éœ€è¦ç‰¹æ®Šè€ƒè™‘**
```
é€‚é…è¦ç‚¹ï¼š
- Cookieå¯èƒ½è¢«ç³»ç»Ÿæ¸…ç†ï¼Œéœ€è¦å¤‡ç”¨å­˜å‚¨
- iOS Safariæœ‰ç‰¹æ®Šé™åˆ¶
- WebViewç¯å¢ƒè¡Œä¸ºä¸ä¸€è‡´
- æ¨èä½¿ç”¨æ··åˆå­˜å‚¨ç­–ç•¥
```

### 7.3 å®é™…åº”ç”¨æœ€ä½³å®è·µ


**ğŸ’¡ Cookieæ“ä½œå°è£…**
```javascript
// æ¨èçš„Cookieå·¥å…·ç±»ä½¿ç”¨
const auth = {
    login: (token) => CookieManager.set('authToken', token, 7),
    logout: () => CookieManager.remove('authToken'),
    isLoggedIn: () => CookieManager.exists('authToken'),
    getToken: () => CookieManager.get('authToken')
};
```

**ğŸ¯ é¡µé¢é—´çŠ¶æ€åŒæ­¥**
- ä½¿ç”¨path=/ç¡®ä¿å…¨ç«™å…±äº«
- é‡è¦æ•°æ®è€ƒè™‘LocalStorageå¤‡ä»½
- è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´

**ğŸ“± ç§»åŠ¨ç«¯é€‚é…ç­–ç•¥**
- æ£€æµ‹ç¯å¢ƒï¼Œä½¿ç”¨ä¸åŒç­–ç•¥
- Cookie + LocalStorageåŒé‡ä¿é™©
- è®¾ç½®SameSite=Laxæé«˜å…¼å®¹æ€§

### 7.4 å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ


| é—®é¢˜æƒ…å†µ | **åŸå› åˆ†æ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|
| ğŸ”¸ **Cookieä¸¢å¤±** | `ç§»åŠ¨ç«¯ç³»ç»Ÿæ¸…ç†` | `ä½¿ç”¨æ··åˆå­˜å‚¨ç­–ç•¥` |
| ğŸ”¸ **è·¨é¡µé¢ä¸åŒæ­¥** | `è·¯å¾„è®¾ç½®é”™è¯¯` | `ä½¿ç”¨path=/å…¨å±€å…±äº«` |
| ğŸ”¸ **ç‰¹æ®Šå­—ç¬¦ä¹±ç ** | `æœªæ­£ç¡®ç¼–ç ` | `ä½¿ç”¨encodeURIComponent` |
| ğŸ”¸ **iOS Safariå¤±æ•ˆ** | `ITPæ™ºèƒ½é˜²è·Ÿè¸ª` | `ç¼©çŸ­æœ‰æ•ˆæœŸï¼Œæ·»åŠ ç”¨æˆ·äº¤äº’` |

**æ ¸å¿ƒè®°å¿†**ï¼š
- Cookieæ˜¯æµè§ˆå™¨çš„è‡ªåŠ¨åŒ–ä¼šå‘˜å¡ç³»ç»Ÿ
- JavaScriptå¯ä»¥è¯»å†™æ™®é€šCookieä½†æœ‰å®‰å…¨é™åˆ¶  
- é¡µé¢é—´å…±äº«é åŸŸåè·¯å¾„åŒ¹é…è§„åˆ™
- ç§»åŠ¨ç«¯ä¸ç¨³å®šéœ€è¦å¤‡ç”¨å­˜å‚¨æ–¹æ¡ˆ