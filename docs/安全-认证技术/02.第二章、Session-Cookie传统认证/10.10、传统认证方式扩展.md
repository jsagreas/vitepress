---
title: 10ã€ä¼ ç»Ÿè®¤è¯æ–¹å¼æ‰©å±•
---
## ğŸ“š ç›®å½•

1. [ä¼ ç»Ÿè®¤è¯æ–¹å¼æ¦‚è¿°](#1-ä¼ ç»Ÿè®¤è¯æ–¹å¼æ¦‚è¿°)
2. [ç”¨æˆ·åå¯†ç è®¤è¯æœºåˆ¶](#2-ç”¨æˆ·åå¯†ç è®¤è¯æœºåˆ¶)
3. [Session-Cookieè®¤è¯è¯¦è§£](#3-Session-Cookieè®¤è¯è¯¦è§£)
4. [åŸºäºè¡¨å•çš„è®¤è¯å®ç°](#4-åŸºäºè¡¨å•çš„è®¤è¯å®ç°)
5. [ä¼ ç»Ÿè®¤è¯çš„ä¼˜ç¼ºç‚¹åˆ†æ](#5-ä¼ ç»Ÿè®¤è¯çš„ä¼˜ç¼ºç‚¹åˆ†æ)
6. [å®‰å…¨æ€§è€ƒè™‘ä¸æœ€ä½³å®è·µ](#6-å®‰å…¨æ€§è€ƒè™‘ä¸æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä¼ ç»Ÿè®¤è¯æ–¹å¼æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è®¤è¯

**ğŸ”¸ è®¤è¯ï¼ˆAuthenticationï¼‰çš„æœ¬è´¨**
```
ç®€å•ç†è§£ï¼šè¯æ˜"ä½ æ˜¯ä½ "çš„è¿‡ç¨‹
å°±åƒè¿›å°åŒºè¦åˆ·é—¨ç¦å¡ï¼Œè¯æ˜ä½ æ˜¯è¿™ä¸ªå°åŒºçš„ä½æˆ·

åœ¨ç½‘ç»œä¸–ç•Œï¼š
â€¢ ç”¨æˆ·å£°ç§°è‡ªå·±æ˜¯å¼ ä¸‰
â€¢ ç³»ç»Ÿéœ€è¦éªŒè¯ï¼šè¿™ä¸ªäººçœŸçš„æ˜¯å¼ ä¸‰å—ï¼Ÿ
â€¢ é€šè¿‡å¯†ç ã€æŒ‡çº¹ç­‰æ–¹å¼æ¥è¯æ˜èº«ä»½
```

**ğŸ’¡ ç”Ÿæ´»ä¸­çš„è®¤è¯ä¾‹å­**
```
ğŸ  è¿›å°åŒºï¼šåˆ·é—¨ç¦å¡ æˆ– äººè„¸è¯†åˆ«
ğŸ¦ é“¶è¡Œå–æ¬¾ï¼šé“¶è¡Œå¡ + å¯†ç 
ğŸ“± æ‰‹æœºè§£é”ï¼šæŒ‡çº¹ æˆ– é¢éƒ¨è¯†åˆ« æˆ– å¯†ç 
ğŸ« æ¼”å”±ä¼šï¼šé—¨ç¥¨ + èº«ä»½è¯

ç½‘ç«™è®¤è¯ï¼šç”¨æˆ·å + å¯†ç 
```

### 1.2 ä¼ ç»Ÿè®¤è¯çš„å‘å±•å†ç¨‹

```
æ—©æœŸäº’è”ç½‘æ—¶ä»£ï¼š
ç”¨æˆ· â†’ è¾“å…¥ç”¨æˆ·åå¯†ç  â†’ æœåŠ¡å™¨éªŒè¯ â†’ å…è®¸è®¿é—®

é—®é¢˜ï¼šHTTPæ˜¯æ— çŠ¶æ€åè®®
æ¯æ¬¡è¯·æ±‚éƒ½ä¸çŸ¥é“ç”¨æˆ·æ˜¯è°ï¼Œéœ€è¦é‡å¤éªŒè¯

è§£å†³æ–¹æ¡ˆï¼šSession-Cookieæœºåˆ¶è¯ç”Ÿ
è®©æœåŠ¡å™¨"è®°ä½"ç”¨æˆ·çš„ç™»å½•çŠ¶æ€
```

---

## 2. ğŸ‘¤ ç”¨æˆ·åå¯†ç è®¤è¯æœºåˆ¶


### 2.1 åŸºæœ¬æ¦‚å¿µ

**ğŸ”¸ ç”¨æˆ·åå¯†ç è®¤è¯çš„åŸç†**
```
æ ¸å¿ƒæ€æƒ³ï¼šåŸºäº"ä½ çŸ¥é“ä»€ä¹ˆ"çš„è®¤è¯æ–¹å¼

ç»„æˆéƒ¨åˆ†ï¼š
â€¢ ç”¨æˆ·åï¼ˆUsernameï¼‰ï¼šèº«ä»½æ ‡è¯†ï¼Œå‘Šè¯‰ç³»ç»Ÿä½ æ˜¯è°
â€¢ å¯†ç ï¼ˆPasswordï¼‰ï¼šèº«ä»½å‡­è¯ï¼Œè¯æ˜ä½ çœŸçš„æ˜¯è¿™ä¸ªäºº

å°±åƒé“¶è¡Œå¡ï¼š
â€¢ å¡å· = ç”¨æˆ·åï¼ˆå‘Šè¯‰ç³»ç»Ÿå“ªä¸ªè´¦æˆ·ï¼‰
â€¢ å¯†ç  = å¯†ç ï¼ˆè¯æ˜å¡æ˜¯ä½ çš„ï¼‰
```

### 2.2 è®¤è¯æµç¨‹è¯¦è§£

```
ç”¨æˆ·ç«¯                     æœåŠ¡å™¨ç«¯
  |                           |
  |--[1]è¾“å…¥ç”¨æˆ·åå¯†ç --------->|
  |   user: "zhangsan"        |--[2]æŸ¥è¯¢æ•°æ®åº“
  |   pass: "123456"          |    éªŒè¯ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
  |                           |    éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®
  |<--[3]è¿”å›è®¤è¯ç»“æœ---------|
  |   æˆåŠŸï¼šå…è®¸è®¿é—®           |
  |   å¤±è´¥ï¼šæ‹’ç»è®¿é—®           |
```

### 2.3 å¯†ç å­˜å‚¨å®‰å…¨

**ğŸ”’ ä¸ºä»€ä¹ˆä¸èƒ½æ˜æ–‡å­˜å‚¨å¯†ç ï¼Ÿ**
```
âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥å­˜å‚¨å¯†ç 
æ•°æ®åº“è®°å½•ï¼š
user_id | username | password
   1    | zhangsan | 123456    â† å±é™©ï¼

âœ… æ­£ç¡®åšæ³•ï¼šå­˜å‚¨å¯†ç å“ˆå¸Œå€¼
æ•°æ®åº“è®°å½•ï¼š
user_id | username | password_hash
   1    | zhangsan | $2b$10$N9qo8uLOickgx2ZMRZoMye...

å®‰å…¨åŸç†ï¼š
â€¢ å“ˆå¸Œç®—æ³•æ˜¯å•å‘çš„ï¼Œæ— æ³•é€†å‘æ¨å‡ºåŸå¯†ç 
â€¢ å³ä½¿æ•°æ®åº“è¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ‹¿ä¸åˆ°çœŸå®å¯†ç 
```

**ğŸ’» ç®€å•å®ç°ç¤ºä¾‹**
```javascript
// ç”¨æˆ·æ³¨å†Œæ—¶ï¼šåŠ å¯†å¯†ç 
const bcrypt = require('bcrypt');

async function registerUser(username, password) {
    // ç”Ÿæˆå“ˆå¸Œå€¼
    const hashedPassword = await bcrypt.hash(password, 10);
    
    // å­˜å‚¨åˆ°æ•°æ®åº“
    await saveToDatabase(username, hashedPassword);
}

// ç”¨æˆ·ç™»å½•æ—¶ï¼šéªŒè¯å¯†ç 
async function loginUser(username, password) {
    // ä»æ•°æ®åº“è·å–å“ˆå¸Œå€¼
    const user = await getUserFromDatabase(username);
    
    // æ¯”è¾ƒå¯†ç 
    const isValid = await bcrypt.compare(password, user.hashedPassword);
    
    return isValid; // trueè¡¨ç¤ºå¯†ç æ­£ç¡®
}
```

---

## 3. ğŸª Session-Cookieè®¤è¯è¯¦è§£


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦Session-Cookieï¼Ÿ

**ğŸ¤” HTTPæ— çŠ¶æ€çš„é—®é¢˜**
```
é—®é¢˜åœºæ™¯ï¼š
1. ç”¨æˆ·ç™»å½•ç½‘ç«™ âœ…
2. è®¿é—®ä¸ªäººèµ„æ–™é¡µé¢ â†’ æœåŠ¡å™¨ï¼šä½ æ˜¯è°ï¼Ÿâ“
3. è®¿é—®è®¾ç½®é¡µé¢ â†’ æœåŠ¡å™¨ï¼šä½ æ˜¯è°ï¼Ÿâ“
4. æ¯æ¬¡éƒ½è¦é‡æ–°éªŒè¯èº«ä»½ ğŸ˜«

HTTPæ— çŠ¶æ€ç‰¹æ€§ï¼š
â€¢ æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„
â€¢ æœåŠ¡å™¨ä¸è®°ä½ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆ
â€¢ å°±åƒå¥å¿˜ç—‡æ‚£è€…ï¼Œæ¯æ¬¡è§é¢éƒ½ä¸è®¤è¯†ä½ 
```

### 3.2 Session-Cookieæœºåˆ¶åŸç†

**ğŸ« Sessionï¼šæœåŠ¡å™¨ç«¯çš„"ä¼šè¯è®°å½•"**
```
Sessionå°±åƒé…’åº—çš„å…¥ä½è®°å½•ï¼š
â€¢ æˆ¿é—´å·ï¼šSession ID
â€¢ å…¥ä½ä¿¡æ¯ï¼šç”¨æˆ·ä¿¡æ¯ã€ç™»å½•çŠ¶æ€ç­‰
â€¢ å­˜å‚¨ä½ç½®ï¼šæœåŠ¡å™¨å†…å­˜æˆ–æ•°æ®åº“

Sessionå†…å®¹ç¤ºä¾‹ï¼š
{
  "sessionId": "abc123xyz",
  "userId": 1001,
  "username": "zhangsan",
  "loginTime": "2025-08-12 15:30:00",
  "isLoggedIn": true
}
```

**ğŸª Cookieï¼šæµè§ˆå™¨ç«¯çš„"æˆ¿å¡"**
```
Cookieå°±åƒé…’åº—æˆ¿å¡ï¼š
â€¢ å¡ä¸Šæœ‰æˆ¿é—´å·ï¼ˆSession IDï¼‰
â€¢ æ¯æ¬¡è¿›å‡ºéƒ½è¦åˆ·å¡
â€¢ ç¦»å¼€é…’åº—åæˆ¿å¡å¤±æ•ˆ

Cookieå†…å®¹ç¤ºä¾‹ï¼š
sessionId=abc123xyz; path=/; httpOnly=true
```

### 3.3 å®Œæ•´è®¤è¯æµç¨‹å›¾è§£

```
ç”¨æˆ·æµè§ˆå™¨              WebæœåŠ¡å™¨              Sessionå­˜å‚¨
     |                     |                     |
[1]  |--ç™»å½•è¯·æ±‚----------->|                     |
     |  POST /login        |                     |
     |  username=zhangsan  |                     |
     |  password=123456    |                     |
     |                     |                     |
[2]  |                     |--éªŒè¯ç”¨æˆ·åå¯†ç ----->| æ•°æ®åº“
     |                     |<--éªŒè¯æˆåŠŸ----------|
     |                     |                     |
[3]  |                     |--åˆ›å»ºSession------->|
     |                     |  sessionId=abc123   |
     |                     |  userId=1001        |
     |                     |  username=zhangsan  |
     |                     |<--ä¿å­˜æˆåŠŸ----------|
     |                     |                     |
[4]  |<--è¿”å›Cookie--------|                     |
     |  Set-Cookie:        |                     |
     |  sessionId=abc123   |                     |
     |                     |                     |
[5]  |--è®¿é—®å—ä¿æŠ¤é¡µé¢----->|                     |
     |  GET /profile       |                     |
     |  Cookie:            |                     |
     |  sessionId=abc123   |                     |
     |                     |                     |
[6]  |                     |--æŸ¥è¯¢Session------->|
     |                     |  æ ¹æ®abc123æŸ¥è¯¢      |
     |                     |<--è¿”å›ç”¨æˆ·ä¿¡æ¯------|
     |                     |  æ‰¾åˆ°zhangsan       |
     |                     |                     |
[7]  |<--è¿”å›é¡µé¢å†…å®¹------|                     |
     |  ä¸ªäººèµ„æ–™é¡µé¢        |                     |
```

### 3.4 Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†

**â° Sessionçš„åˆ›å»ºå’Œé”€æ¯**
```
åˆ›å»ºæ—¶æœºï¼š
â€¢ ç”¨æˆ·é¦–æ¬¡è®¿é—®ç½‘ç«™
â€¢ ç”¨æˆ·æˆåŠŸç™»å½•å

æ›´æ–°æ—¶æœºï¼š
â€¢ ç”¨æˆ·æ¯æ¬¡è®¿é—®é¡µé¢
â€¢ åˆ·æ–°Sessionè¿‡æœŸæ—¶é—´

é”€æ¯æ—¶æœºï¼š
â€¢ ç”¨æˆ·ä¸»åŠ¨ç™»å‡º
â€¢ Sessionè¶…æ—¶ï¼ˆå¦‚30åˆ†é’Ÿæ— æ´»åŠ¨ï¼‰
â€¢ æœåŠ¡å™¨é‡å¯ï¼ˆå¦‚æœå­˜åœ¨å†…å­˜ä¸­ï¼‰
```

**ğŸ’» ç®€å•å®ç°ç¤ºä¾‹**
```javascript
// Express.js ä¸­çš„Sessionå®ç°
const session = require('express-session');

app.use(session({
    secret: 'my-secret-key',           // åŠ å¯†å¯†é’¥
    resave: false,                     // ä¸å¼ºåˆ¶ä¿å­˜
    saveUninitialized: false,          // ä¸ä¿å­˜æœªåˆå§‹åŒ–çš„session
    cookie: { 
        maxAge: 30 * 60 * 1000,       // 30åˆ†é’Ÿè¿‡æœŸ
        httpOnly: true,                // åªèƒ½é€šè¿‡HTTPè®¿é—®ï¼Œé˜²æ­¢XSS
        secure: false                  // HTTPSæ—¶è®¾ä¸ºtrue
    }
}));

// ç™»å½•å¤„ç†
app.post('/login', async (req, res) => {
    const { username, password } = req.body;
    
    // éªŒè¯ç”¨æˆ·åå¯†ç 
    const user = await validateUser(username, password);
    
    if (user) {
        // åˆ›å»ºSession
        req.session.userId = user.id;
        req.session.username = user.username;
        req.session.isLoggedIn = true;
        
        res.json({ success: true, message: 'ç™»å½•æˆåŠŸ' });
    } else {
        res.json({ success: false, message: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯' });
    }
});

// å—ä¿æŠ¤çš„è·¯ç”±
app.get('/profile', (req, res) => {
    // æ£€æŸ¥Session
    if (req.session.isLoggedIn) {
        res.json({ 
            username: req.session.username,
            message: 'æ¬¢è¿è®¿é—®ä¸ªäººèµ„æ–™' 
        });
    } else {
        res.status(401).json({ message: 'è¯·å…ˆç™»å½•' });
    }
});

// ç™»å‡ºå¤„ç†
app.post('/logout', (req, res) => {
    // é”€æ¯Session
    req.session.destroy((err) => {
        if (err) {
            res.json({ success: false, message: 'ç™»å‡ºå¤±è´¥' });
        } else {
            res.json({ success: true, message: 'å·²æˆåŠŸç™»å‡º' });
        }
    });
});
```

---

## 4. ğŸ“ åŸºäºè¡¨å•çš„è®¤è¯å®ç°


### 4.1 ä»€ä¹ˆæ˜¯åŸºäºè¡¨å•çš„è®¤è¯

**ğŸ”¸ è¡¨å•è®¤è¯çš„æ¦‚å¿µ**
```
åŸºäºè¡¨å•çš„è®¤è¯ = ç”¨æˆ·åå¯†ç è®¤è¯ + Session-Cookieæœºåˆ¶

ç‰¹ç‚¹ï¼š
â€¢ ç”¨æˆ·é€šè¿‡HTMLè¡¨å•è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
â€¢ è¡¨å•æ•°æ®é€šè¿‡POSTè¯·æ±‚æäº¤åˆ°æœåŠ¡å™¨
â€¢ æœåŠ¡å™¨éªŒè¯ååˆ›å»ºSessionï¼Œè¿”å›Cookie
â€¢ åç»­è¯·æ±‚é€šè¿‡Cookieæºå¸¦Session ID

å°±åƒå¡«å†™çº¸è´¨è¡¨æ ¼è¿›è¡Œä¼šå‘˜æ³¨å†Œï¼š
â€¢ è¡¨æ ¼ = HTMLè¡¨å•
â€¢ å¡«å†™ä¿¡æ¯ = è¾“å…¥ç”¨æˆ·åå¯†ç 
â€¢ æäº¤è¡¨æ ¼ = POSTè¯·æ±‚
â€¢ è·å¾—ä¼šå‘˜å¡ = æ¥æ”¶Cookie
```

### 4.2 å‰ç«¯è¡¨å•è®¾è®¡

**ğŸ¨ ç™»å½•è¡¨å•çš„åŸºæœ¬ç»“æ„**
```html
<!-- ç®€æ´çš„ç™»å½•è¡¨å• -->
<form action="/login" method="POST" id="loginForm">
    <div>
        <label for="username">ç”¨æˆ·åï¼š</label>
        <input type="text" id="username" name="username" required>
    </div>
    
    <div>
        <label for="password">å¯†ç ï¼š</label>
        <input type="password" id="password" name="password" required>
    </div>
    
    <div>
        <button type="submit">ç™»å½•</button>
    </div>
</form>

<script>
// ç®€å•çš„è¡¨å•æäº¤å¤„ç†
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const loginData = {
        username: formData.get('username'),
        password: formData.get('password')
    };
    
    try {
        const response = await fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(loginData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('ç™»å½•æˆåŠŸï¼');
            window.location.href = '/dashboard'; // è·³è½¬åˆ°ä¸»é¡µ
        } else {
            alert('ç™»å½•å¤±è´¥ï¼š' + result.message);
        }
    } catch (error) {
        alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
    }
});
</script>
```

### 4.3 æœåŠ¡å™¨ç«¯è®¤è¯å¤„ç†

**ğŸ–¥ï¸ å®Œæ•´çš„è®¤è¯æµç¨‹å®ç°**
```javascript
const express = require('express');
const bcrypt = require('bcrypt');
const session = require('express-session');

const app = express();

// ä¸­é—´ä»¶é…ç½®
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(session({
    secret: 'your-secret-key',
    resave: false,
    saveUninitialized: false,
    cookie: { maxAge: 24 * 60 * 60 * 1000 } // 24å°æ—¶
}));

// æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“
const users = [
    {
        id: 1,
        username: 'admin',
        password: '$2b$10$N9qo8uLOickgx2ZMRZoMye...' // é¢„å…ˆåŠ å¯†çš„å¯†ç 
    }
];

// ç™»å½•å¤„ç†
app.post('/login', async (req, res) => {
    const { username, password } = req.body;
    
    // 1. éªŒè¯è¾“å…¥
    if (!username || !password) {
        return res.json({ 
            success: false, 
            message: 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ' 
        });
    }
    
    // 2. æŸ¥æ‰¾ç”¨æˆ·
    const user = users.find(u => u.username === username);
    if (!user) {
        return res.json({ 
            success: false, 
            message: 'ç”¨æˆ·åä¸å­˜åœ¨' 
        });
    }
    
    // 3. éªŒè¯å¯†ç 
    const isPasswordValid = await bcrypt.compare(password, user.password);
    if (!isPasswordValid) {
        return res.json({ 
            success: false, 
            message: 'å¯†ç é”™è¯¯' 
        });
    }
    
    // 4. åˆ›å»ºSession
    req.session.userId = user.id;
    req.session.username = user.username;
    req.session.isAuthenticated = true;
    
    // 5. è¿”å›æˆåŠŸå“åº”
    res.json({ 
        success: true, 
        message: 'ç™»å½•æˆåŠŸ',
        user: { 
            id: user.id, 
            username: user.username 
        }
    });
});

// è®¤è¯ä¸­é—´ä»¶
function requireAuth(req, res, next) {
    if (req.session.isAuthenticated) {
        next(); // å·²è®¤è¯ï¼Œç»§ç»­å¤„ç†
    } else {
        res.status(401).json({ 
            success: false, 
            message: 'è¯·å…ˆç™»å½•' 
        });
    }
}

// å—ä¿æŠ¤çš„è·¯ç”±
app.get('/dashboard', requireAuth, (req, res) => {
    res.json({
        message: `æ¬¢è¿ï¼Œ${req.session.username}ï¼`,
        user: {
            id: req.session.userId,
            username: req.session.username
        }
    });
});

// ç™»å‡ºå¤„ç†
app.post('/logout', (req, res) => {
    req.session.destroy((err) => {
        if (err) {
            res.json({ success: false, message: 'ç™»å‡ºå¤±è´¥' });
        } else {
            res.json({ success: true, message: 'å·²æˆåŠŸç™»å‡º' });
        }
    });
});
```

### 4.4 è®¤è¯çŠ¶æ€ç®¡ç†

**ğŸ”„ å‰ç«¯çŠ¶æ€ç®¡ç†ç¤ºä¾‹**
```javascript
// ç®€å•çš„è®¤è¯çŠ¶æ€ç®¡ç†
class AuthManager {
    constructor() {
        this.isLoggedIn = false;
        this.user = null;
        this.checkAuthStatus();
    }
    
    // æ£€æŸ¥è®¤è¯çŠ¶æ€
    async checkAuthStatus() {
        try {
            const response = await fetch('/api/me', {
                credentials: 'include' // æºå¸¦Cookie
            });
            
            if (response.ok) {
                const user = await response.json();
                this.isLoggedIn = true;
                this.user = user;
                this.updateUI();
            } else {
                this.isLoggedIn = false;
                this.user = null;
            }
        } catch (error) {
            console.error('æ£€æŸ¥è®¤è¯çŠ¶æ€å¤±è´¥:', error);
        }
    }
    
    // ç™»å½•
    async login(username, password) {
        try {
            const response = await fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password }),
                credentials: 'include'
            });
            
            const result = await response.json();
            
            if (result.success) {
                this.isLoggedIn = true;
                this.user = result.user;
                this.updateUI();
                return { success: true };
            } else {
                return { success: false, message: result.message };
            }
        } catch (error) {
            return { success: false, message: 'ç½‘ç»œé”™è¯¯' };
        }
    }
    
    // ç™»å‡º
    async logout() {
        try {
            await fetch('/logout', {
                method: 'POST',
                credentials: 'include'
            });
            
            this.isLoggedIn = false;
            this.user = null;
            this.updateUI();
        } catch (error) {
            console.error('ç™»å‡ºå¤±è´¥:', error);
        }
    }
    
    // æ›´æ–°ç•Œé¢
    updateUI() {
        const loginForm = document.getElementById('loginForm');
        const userInfo = document.getElementById('userInfo');
        
        if (this.isLoggedIn) {
            loginForm.style.display = 'none';
            userInfo.style.display = 'block';
            userInfo.innerHTML = `
                <p>æ¬¢è¿ï¼Œ${this.user.username}ï¼</p>
                <button onclick="authManager.logout()">ç™»å‡º</button>
            `;
        } else {
            loginForm.style.display = 'block';
            userInfo.style.display = 'none';
        }
    }
}

// å…¨å±€å®ä¾‹
const authManager = new AuthManager();
```

---

## 5. âš–ï¸ ä¼ ç»Ÿè®¤è¯çš„ä¼˜ç¼ºç‚¹åˆ†æ


### 5.1 ä¼˜ç‚¹åˆ†æ

**âœ… Session-Cookieè®¤è¯çš„ä¼˜åŠ¿**
```
ğŸ”¸ å®ç°ç®€å•
â€¢ æœåŠ¡å™¨æ¡†æ¶é€šå¸¸å†…ç½®æ”¯æŒ
â€¢ å¼€å‘å¤æ‚åº¦ä½ï¼Œå­¦ä¹ æˆæœ¬å°
â€¢ å¤§é‡ç°æˆçš„åº“å’Œå·¥å…·

ğŸ”¸ å®‰å…¨æ€§è¾ƒé«˜
â€¢ Sessionæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œç”¨æˆ·æ— æ³•ç›´æ¥ä¿®æ”¹
â€¢ Cookieå¯ä»¥è®¾ç½®HttpOnlyï¼Œé˜²æ­¢XSSæ”»å‡»
â€¢ å¯ä»¥è®¾ç½®Secureæ ‡å¿—ï¼Œä»…åœ¨HTTPSä¸‹ä¼ è¾“

ğŸ”¸ æœåŠ¡å™¨æ§åˆ¶åŠ›å¼º
â€¢ å¯ä»¥éšæ—¶åœ¨æœåŠ¡å™¨ç«¯åºŸé™¤Session
â€¢ å®¹æ˜“å®ç°è¸¢å‡ºç”¨æˆ·åŠŸèƒ½
â€¢ ä¾¿äºç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°é‡

ğŸ”¸ æµè§ˆå™¨åŸç”Ÿæ”¯æŒ
â€¢ Cookieæ˜¯æµè§ˆå™¨æ ‡å‡†åŠŸèƒ½
â€¢ è‡ªåŠ¨æºå¸¦ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†
â€¢ æ”¯æŒè¿‡æœŸæ—¶é—´è®¾ç½®
```

### 5.2 ç¼ºç‚¹åˆ†æ

**âŒ Session-Cookieè®¤è¯çš„å±€é™**
```
ğŸ”¸ å¯æ‰©å±•æ€§é—®é¢˜
â€¢ Sessioné€šå¸¸å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­
â€¢ å¤šæœåŠ¡å™¨éƒ¨ç½²æ—¶éœ€è¦Sessionå…±äº«
â€¢ å¢åŠ äº†æœåŠ¡å™¨çš„å†…å­˜è´Ÿæ‹…

ğŸ”¸ ç§»åŠ¨ç«¯å…¼å®¹æ€§
â€¢ ç§»åŠ¨APPä¸­Cookieæ”¯æŒæœ‰é™
â€¢ éœ€è¦é¢å¤–å¤„ç†Cookieå­˜å‚¨
â€¢ è·¨åŸŸé—®é¢˜å¤æ‚

ğŸ”¸ æ— çŠ¶æ€æ¶æ„å†²çª
â€¢ è¿èƒŒäº†RESTful APIçš„æ— çŠ¶æ€åŸåˆ™
â€¢ éš¾ä»¥ä¸å¾®æœåŠ¡æ¶æ„å®Œç¾é…åˆ
â€¢ è´Ÿè½½å‡è¡¡é…ç½®å¤æ‚

ğŸ”¸ å®‰å…¨é£é™©
â€¢ å®¹æ˜“å—åˆ°CSRFæ”»å‡»
â€¢ SessionåŠ«æŒé£é™©
â€¢ éœ€è¦é¢å¤–çš„å®‰å…¨æªæ–½
```

### 5.3 é€‚ç”¨åœºæ™¯å¯¹æ¯”è¡¨


| ä½¿ç”¨åœºæ™¯ | **é€‚ç”¨ç¨‹åº¦** | **è¯´æ˜** |
|---------|------------|---------|
| ğŸŒ **ä¼ ç»ŸWebåº”ç”¨** | `ğŸŸ¢ éå¸¸é€‚åˆ` | `ç»å…¸çš„æœåŠ¡å™¨æ¸²æŸ“åº”ç”¨ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½` |
| ğŸ“± **ç§»åŠ¨ç«¯APP** | `ğŸŸ¡ éƒ¨åˆ†é€‚åˆ` | `éœ€è¦é¢å¤–å¤„ç†Cookieï¼Œä¸å¦‚Tokenæ–¹ä¾¿` |
| ğŸ”„ **å•é¡µåº”ç”¨(SPA)** | `ğŸŸ¡ éƒ¨åˆ†é€‚åˆ` | `å¯ä»¥ä½¿ç”¨ï¼Œä½†Tokenæ›´ç¬¦åˆå‰åç«¯åˆ†ç¦»` |
| ğŸ¯ **RESTful API** | `ğŸ”´ ä¸å¤ªé€‚åˆ` | `è¿èƒŒæ— çŠ¶æ€åŸåˆ™ï¼ŒTokenæ–¹æ¡ˆæ›´å¥½` |
| â˜ï¸ **å¾®æœåŠ¡æ¶æ„** | `ğŸ”´ ä¸å¤ªé€‚åˆ` | `Sessionå…±äº«å¤æ‚ï¼Œæ¨èJWTç­‰æ–¹æ¡ˆ` |
| ğŸ–¥ï¸ **ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ** | `ğŸŸ¢ éå¸¸é€‚åˆ` | `å®‰å…¨è¦æ±‚é«˜ï¼Œä¾¿äºç®¡ç†å’Œæ§åˆ¶` |

---

## 6. ğŸ›¡ï¸ å®‰å…¨æ€§è€ƒè™‘ä¸æœ€ä½³å®è·µ


### 6.1 å¸¸è§å®‰å…¨å¨èƒ

**âš ï¸ CSRFæ”»å‡»é˜²æŠ¤**
```
CSRFæ”»å‡»åŸç†ï¼š
æ¶æ„ç½‘ç«™åˆ©ç”¨ç”¨æˆ·çš„Cookieå‘èµ·è·¨ç«™è¯·æ±‚

é˜²æŠ¤æªæ–½ï¼š
1. ä½¿ç”¨CSRF Token
2. æ£€æŸ¥Refererå¤´
3. ä½¿ç”¨SameSite Cookieå±æ€§

// CSRF Tokenå®ç°ç¤ºä¾‹
app.use((req, res, next) => {
    if (!req.session.csrfToken) {
        req.session.csrfToken = generateRandomToken();
    }
    res.locals.csrfToken = req.session.csrfToken;
    next();
});

app.post('/sensitive-action', (req, res) => {
    if (req.body.csrfToken !== req.session.csrfToken) {
        return res.status(403).json({ error: 'CSRF token invalid' });
    }
    // å¤„ç†è¯·æ±‚...
});
```

**ğŸ”’ SessionåŠ«æŒé˜²æŠ¤**
```
SessionåŠ«æŒï¼šæ”»å‡»è€…è·å–ç”¨æˆ·çš„Session ID

é˜²æŠ¤æªæ–½ï¼š
1. ä½¿ç”¨HTTPSä¼ è¾“
2. è®¾ç½®Cookieä¸ºHttpOnly
3. å®šæœŸæ›´æ¢Session ID
4. æ£€æŸ¥ç”¨æˆ·IPå’ŒUser-Agent

// Sessionå®‰å…¨é…ç½®
app.use(session({
    secret: 'complex-secret-key',
    cookie: {
        httpOnly: true,      // é˜²æ­¢XSS
        secure: true,        // ä»…HTTPSä¼ è¾“
        sameSite: 'strict',  // é˜²æ­¢CSRF
        maxAge: 1800000      // 30åˆ†é’Ÿè¿‡æœŸ
    },
    rolling: true,           // æ¯æ¬¡è¯·æ±‚éƒ½é‡ç½®è¿‡æœŸæ—¶é—´
    resave: false,
    saveUninitialized: false
}));
```

### 6.2 æœ€ä½³å®è·µæ¸…å•

**ğŸ“‹ Session-Cookieå®‰å…¨æ£€æŸ¥æ¸…å•**

- âœ… **Cookieå®‰å…¨è®¾ç½®**
  - `httpOnly: true` - é˜²æ­¢XSSæ”»å‡»
  - `secure: true` - ä»…åœ¨HTTPSä¸‹ä¼ è¾“
  - `sameSite: 'strict'` - é˜²æ­¢CSRFæ”»å‡»

- âœ… **Sessionç®¡ç†**
  - åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ15-30åˆ†é’Ÿï¼‰
  - ç™»å½•æˆåŠŸåé‡æ–°ç”ŸæˆSession ID
  - æ•æ„Ÿæ“ä½œå‰é‡æ–°éªŒè¯èº«ä»½

- âœ… **å¯†ç å®‰å…¨**
  - ä½¿ç”¨å¼ºå“ˆå¸Œç®—æ³•ï¼ˆbcryptã€scryptï¼‰
  - å®æ–½å¯†ç å¤æ‚åº¦è¦æ±‚
  - é˜²æ­¢æš´åŠ›ç ´è§£ï¼ˆé™åˆ¶ç™»å½•å°è¯•æ¬¡æ•°ï¼‰

- âœ… **ä¼ è¾“å®‰å…¨**
  - å¼ºåˆ¶ä½¿ç”¨HTTPS
  - å®æ–½HSTSç­–ç•¥
  - å®šæœŸæ›´æ–°SSLè¯ä¹¦

**â±ï¸ å®é™…éƒ¨ç½²å»ºè®®**
```javascript
// ç”Ÿäº§ç¯å¢ƒSessioné…ç½®ç¤ºä¾‹
const session = require('express-session');
const MongoStore = require('connect-mongo');

app.use(session({
    secret: process.env.SESSION_SECRET, // ä»ç¯å¢ƒå˜é‡è¯»å–
    store: MongoStore.create({
        mongoUrl: process.env.MONGODB_URI, // ä½¿ç”¨æ•°æ®åº“å­˜å‚¨
        ttl: 30 * 60 // 30åˆ†é’ŸTTL
    }),
    cookie: {
        maxAge: 30 * 60 * 1000, // 30åˆ†é’Ÿ
        httpOnly: true,
        secure: process.env.NODE_ENV === 'production', // ç”Ÿäº§ç¯å¢ƒå¯ç”¨
        sameSite: 'strict'
    },
    resave: false,
    saveUninitialized: false,
    rolling: true, // æ´»åŠ¨æ—¶è‡ªåŠ¨å»¶é•¿
    name: 'sessionId' // è‡ªå®šä¹‰Cookieåç§°
}));
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

```
ğŸ”¸ è®¤è¯æœ¬è´¨ï¼šè¯æ˜"ä½ æ˜¯ä½ "çš„è¿‡ç¨‹ï¼Œç½‘ç»œä¸–ç•Œçš„èº«ä»½éªŒè¯
ğŸ”¸ ç”¨æˆ·åå¯†ç ï¼šæœ€åŸºç¡€çš„è®¤è¯æ–¹å¼ï¼ŒåŸºäº"ä½ çŸ¥é“ä»€ä¹ˆ"
ğŸ”¸ Sessionï¼šæœåŠ¡å™¨ç«¯çš„ä¼šè¯è®°å½•ï¼Œå­˜å‚¨ç”¨æˆ·çŠ¶æ€ä¿¡æ¯
ğŸ”¸ Cookieï¼šæµè§ˆå™¨ç«¯çš„èº«ä»½å‡­è¯ï¼Œè‡ªåŠ¨æºå¸¦Session ID
ğŸ”¸ è¡¨å•è®¤è¯ï¼šç”¨æˆ·åå¯†ç  + Session-Cookieçš„å®Œæ•´å®ç°
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ HTTPæ— çŠ¶æ€ä¸Session-Cookieçš„å…³ç³»**
```
é—®é¢˜ï¼šHTTPåè®®æœ¬èº«ä¸è®°ä½ç”¨æˆ·çŠ¶æ€
è§£å†³ï¼šSession-Cookieæœºåˆ¶è®©æœåŠ¡å™¨"è®°ä½"ç”¨æˆ·

ç±»æ¯”ç†è§£ï¼š
â€¢ HTTP = å¥å¿˜ç—‡åŒ»ç”Ÿï¼Œæ¯æ¬¡éƒ½ä¸è®¤è¯†ä½ 
â€¢ Session = ç—…å†æœ¬ï¼Œè®°å½•ä½ çš„æ‰€æœ‰ä¿¡æ¯
â€¢ Cookie = å°±è¯Šå¡ï¼Œè¯æ˜ä½ æ˜¯å“ªä¸ªç—…äºº
```

**ğŸ”¹ è®¤è¯ä¸æˆæƒçš„åŒºåˆ«**
```
è®¤è¯ï¼ˆAuthenticationï¼‰ï¼šä½ æ˜¯è°ï¼Ÿ
â€¢ éªŒè¯ç”¨æˆ·èº«ä»½
â€¢ ç¡®è®¤ç”¨æˆ·æ˜¯åˆæ³•ç”¨æˆ·

æˆæƒï¼ˆAuthorizationï¼‰ï¼šä½ èƒ½åšä»€ä¹ˆï¼Ÿ
â€¢ æ£€æŸ¥ç”¨æˆ·æƒé™
â€¢ æ§åˆ¶ç”¨æˆ·èƒ½è®¿é—®çš„èµ„æº

æµç¨‹ï¼šå…ˆè®¤è¯èº«ä»½ï¼Œå†æˆæƒæ“ä½œ
```

**ğŸ”¹ å®‰å…¨æ€§çš„å¹³è¡¡**
```
å®‰å…¨ vs ä¾¿åˆ©ï¼š
â€¢ è¿‡æœŸæ—¶é—´ï¼šçŸ­=å®‰å…¨ï¼Œé•¿=ä¾¿åˆ©
â€¢ éªŒè¯é¢‘ç‡ï¼šé¢‘ç¹=å®‰å…¨ï¼Œå°‘=ä¾¿åˆ©
â€¢ å¯†ç å¤æ‚åº¦ï¼šå¤æ‚=å®‰å…¨ï¼Œç®€å•=ä¾¿åˆ©

æœ€ä½³å®è·µï¼šæ ¹æ®åº”ç”¨åœºæ™¯æ‰¾åˆ°å¹³è¡¡ç‚¹
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼

- **ä¼ä¸šç³»ç»Ÿ**ï¼šå†…éƒ¨ç®¡ç†ç³»ç»Ÿçš„é¦–é€‰è®¤è¯æ–¹æ¡ˆ
- **ç”µå•†ç½‘ç«™**ï¼šè´­ç‰©è½¦ã€è®¢å•ç­‰çŠ¶æ€ç®¡ç†
- **å†…å®¹ç®¡ç†**ï¼šç”¨æˆ·ä¸ªæ€§åŒ–å†…å®¹å±•ç¤º
- **ç¤¾äº¤å¹³å°**ï¼šç”¨æˆ·ä¼šè¯çŠ¶æ€ç»´æŠ¤

### 7.4 ä¸ç°ä»£è®¤è¯æŠ€æœ¯çš„å…³ç³»

```
å‘å±•å†ç¨‹ï¼š
ä¼ ç»Ÿè®¤è¯ â†’ JWT â†’ OAuth2 â†’ ç°ä»£è®¤è¯

ä¼ ç»Ÿè®¤è¯çš„ä»·å€¼ï¼š
â€¢ ç†è§£è®¤è¯çš„åŸºæœ¬åŸç†
â€¢ æŒæ¡Webå®‰å…¨çš„åŸºç¡€çŸ¥è¯†
â€¢ ä¸ºå­¦ä¹ é«˜çº§è®¤è¯æŠ€æœ¯æ‰“åŸºç¡€

å­¦ä¹ å»ºè®®ï¼š
â€¢ å…ˆæŒæ¡ä¼ ç»Ÿè®¤è¯çš„åŸç†å’Œå®ç°
â€¢ ç†è§£å…¶ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯
â€¢ å†å­¦ä¹ JWTã€OAuth2ç­‰ç°ä»£æ–¹æ¡ˆ
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†**ï¼š
- Session-Cookieæ˜¯Webè®¤è¯çš„ç»å…¸æ–¹æ¡ˆ
- æœåŠ¡å™¨å­˜çŠ¶æ€ï¼Œæµè§ˆå™¨å¸¦å‡­è¯
- å®‰å…¨ç®€å•æ˜“å®ç°ï¼Œæ‰©å±•æ€§æ˜¯çŸ­æ¿
- ç†è§£åŸç†å¾ˆé‡è¦ï¼Œç°ä»£æ–¹æ¡ˆéƒ½åŸºäºæ­¤