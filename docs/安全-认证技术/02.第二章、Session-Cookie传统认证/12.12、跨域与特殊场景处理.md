---
title: 12ã€è·¨åŸŸä¸ç‰¹æ®Šåœºæ™¯å¤„ç†
---
## ğŸ“š ç›®å½•

1. [è·¨åŸŸé—®é¢˜è¯¦è§£](#1-è·¨åŸŸé—®é¢˜è¯¦è§£)
2. [è·¨åŸŸCookieè®¾ç½®](#2-è·¨åŸŸcookieè®¾ç½®)
3. [CORSé…ç½®ä¸Cookie](#3-corsé…ç½®ä¸cookie)
4. [å­åŸŸåSessionå…±äº«](#4-å­åŸŸåsessionå…±äº«)
5. [å‰åç«¯åˆ†ç¦»æ¶æ„å¤„ç†](#5-å‰åç«¯åˆ†ç¦»æ¶æ„å¤„ç†)
6. [APIæ¥å£è®¤è¯å¤„ç†](#6-apiæ¥å£è®¤è¯å¤„ç†)
7. [ç§»åŠ¨ç«¯WebViewä¸­çš„Cookie](#7-ç§»åŠ¨ç«¯webviewä¸­çš„cookie)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ è·¨åŸŸé—®é¢˜è¯¦è§£


### 1.1 ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜


**ğŸ”¸ é€šä¿—ç†è§£è·¨åŸŸ**
```
è·¨åŸŸå°±åƒ"ä¸²é—¨é—®é¢˜"ï¼š
- ä½ ä½åœ¨Aå°åŒºï¼Œæƒ³å»Bå°åŒºä¸²é—¨
- ä½†æ˜¯å°åŒºæœ‰é—¨ç¦ï¼Œä¸è®©å¤–æ¥äººå‘˜éšä¾¿è¿›å…¥
- æµè§ˆå™¨çš„"åŒæºç­–ç•¥"å°±æ˜¯è¿™ä¸ªé—¨ç¦ç³»ç»Ÿ
```

**ğŸ“‹ åŒæºç­–ç•¥çš„å…·ä½“å«ä¹‰**
```
ä»€ä¹ˆå«"åŒæº"ï¼Ÿå¿…é¡»ä¸‰ä¸ªæ¡ä»¶éƒ½ç›¸åŒï¼š
âœ… åè®®ç›¸åŒï¼šéƒ½æ˜¯httpæˆ–éƒ½æ˜¯https
âœ… åŸŸåç›¸åŒï¼šéƒ½æ˜¯example.com
âœ… ç«¯å£ç›¸åŒï¼šéƒ½æ˜¯80ç«¯å£

ä¸¾ä¾‹è¯´æ˜ï¼š
ä¸»ç«™ï¼šhttps://www.example.com:443
åŒæºï¼šhttps://www.example.com:443/api   âœ…
è·¨åŸŸï¼šhttp://www.example.com:443        âŒ (åè®®ä¸åŒ)
è·¨åŸŸï¼šhttps://api.example.com:443       âŒ (åŸŸåä¸åŒ) 
è·¨åŸŸï¼šhttps://www.example.com:8080      âŒ (ç«¯å£ä¸åŒ)
```

### 1.2 è·¨åŸŸå¯¹Session-Cookieçš„å½±å“


**ğŸš« è·¨åŸŸCookieé™åˆ¶**
```
æµè§ˆå™¨å®‰å…¨æœºåˆ¶ï¼š
1. Cookieä¸èƒ½è·¨åŸŸå‘é€
2. å³ä½¿è®¾ç½®äº†Cookieï¼Œè·¨åŸŸè¯·æ±‚æ—¶ä¹Ÿä¸ä¼šè‡ªåŠ¨æºå¸¦
3. è¿™å¯¼è‡´Sessionè®¤è¯åœ¨è·¨åŸŸåœºæ™¯ä¸‹å¤±æ•ˆ

å®é™…åœºæ™¯ï¼š
å‰ç«¯ï¼šhttp://localhost:3000
åç«¯ï¼šhttp://localhost:8080

é—®é¢˜ï¼šå‰ç«¯è¯·æ±‚åç«¯æ—¶ï¼ŒCookieæ— æ³•æ­£å¸¸å·¥ä½œ
```

**ğŸ”„ è·¨åŸŸè¯·æ±‚æµç¨‹å›¾**
```
å‰ç«¯(localhost:3000)              åç«¯(localhost:8080)
       |                               |
       |--[1]ç™»å½•è¯·æ±‚------------------>|
       |   POST /login                 |
       |                               |--[2]éªŒè¯æˆåŠŸï¼Œåˆ›å»ºSession
       |<--[3]è¿”å›Set-Cookie-----------|   Set-Cookie: JSESSIONID=abc123
       |   (æµè§ˆå™¨æ”¶åˆ°ä½†ä¸å­˜å‚¨)          |
       |                               |
       |--[4]ä¸šåŠ¡è¯·æ±‚------------------>|
       |   GET /user (æ— Cookie)        |
       |                               |--[5]æ— æ³•è¯†åˆ«ç”¨æˆ·
       |<--[6]è¿”å›401æœªæˆæƒ-------------|
```

---

## 2. ğŸª è·¨åŸŸCookieè®¾ç½®


### 2.1 SameSiteå±æ€§è¯¦è§£


**ğŸ“‹ SameSiteå±æ€§çš„ä½œç”¨**
```
SameSiteæ§åˆ¶Cookieåœ¨è·¨ç«™è¯·æ±‚ä¸­çš„è¡Œä¸ºï¼š

ğŸ”¹ Strictï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
- å®Œå…¨ç¦æ­¢è·¨ç«™å‘é€Cookie
- æœ€å®‰å…¨ï¼Œä½†ç”¨æˆ·ä½“éªŒå·®

ğŸ”¹ Laxï¼ˆå®½æ¾æ¨¡å¼ï¼Œé»˜è®¤ï¼‰  
- å…è®¸æŸäº›è·¨ç«™è¯·æ±‚æºå¸¦Cookie
- å¦‚ï¼š<a>é“¾æ¥ã€<form>GETè¯·æ±‚

ğŸ”¹ Noneï¼ˆæ— é™åˆ¶ï¼‰
- å…è®¸æ‰€æœ‰è·¨ç«™è¯·æ±‚æºå¸¦Cookie  
- å¿…é¡»é…åˆSecureä½¿ç”¨ï¼ˆHTTPSï¼‰
```

**ğŸ’» Cookieè®¾ç½®ç¤ºä¾‹**
```javascript
// åç«¯è®¾ç½®Cookieï¼ˆJavaç¤ºä¾‹ï¼‰
@RequestMapping("/login")
public void login(HttpServletResponse response) {
    // åˆ›å»ºCookie
    Cookie cookie = new Cookie("sessionId", "abc123");
    
    // è·¨åŸŸCookieé…ç½®
    cookie.setDomain(".example.com");  // å…è®¸å­åŸŸåå…±äº«
    cookie.setPath("/");               // æ•´ä¸ªç½‘ç«™æœ‰æ•ˆ
    cookie.setMaxAge(3600);           // 1å°æ—¶æœ‰æ•ˆ
    cookie.setHttpOnly(true);         // é˜²XSSæ”»å‡»
    cookie.setSecure(true);           // ä»…HTTPSä¼ è¾“
    
    // å…³é”®ï¼šè·¨åŸŸè®¾ç½®
    response.setHeader("Set-Cookie", 
        "sessionId=abc123; Domain=.example.com; Path=/; " +
        "SameSite=None; Secure; HttpOnly");
    
    response.addCookie(cookie);
}
```

### 2.2 è·¨åŸŸCookieçš„é™åˆ¶æ¡ä»¶


**âš ï¸ å¿…é¡»åŒæ—¶æ»¡è¶³çš„æ¡ä»¶**
```
è¦è®©è·¨åŸŸCookieæ­£å¸¸å·¥ä½œï¼Œéœ€è¦ï¼š

1ï¸âƒ£ SameSite=None
   cookie.setAttribute("SameSite", "None");

2ï¸âƒ£ Secure=trueï¼ˆå¿…é¡»HTTPSï¼‰
   cookie.setSecure(true);

3ï¸âƒ£ å‰ç«¯è¯·æ±‚é…ç½®credentials
   fetch(url, { credentials: 'include' })

4ï¸âƒ£ åç«¯CORSå…è®¸å‡­è¯
   Access-Control-Allow-Credentials: true
```

---

## 3. ğŸ”„ CORSé…ç½®ä¸Cookie


### 3.1 CORSåŸºç¡€æ¦‚å¿µ


**ğŸŒ CORSæ˜¯ä»€ä¹ˆ**
```
CORS = Cross-Origin Resource Sharing (è·¨æºèµ„æºå…±äº«)

é€šä¿—ç†è§£ï¼š
- å°±åƒç»™ä¸²é—¨çš„äººå‘"é€šè¡Œè¯"
- å‘Šè¯‰æµè§ˆå™¨ï¼š"è¿™ä¸ªè·¨åŸŸè¯·æ±‚æ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥æ”¾è¡Œ"
- åç«¯é€šè¿‡ç‰¹æ®Šçš„HTTPå¤´æ¥é¢å‘"é€šè¡Œè¯"
```

**ğŸ“ CORSå“åº”å¤´å«ä¹‰**
```
Access-Control-Allow-Origin: https://frontend.com
â†‘ å…è®¸å“ªä¸ªåŸŸåè®¿é—®

Access-Control-Allow-Methods: GET, POST, PUT
â†‘ å…è®¸å“ªäº›HTTPæ–¹æ³•

Access-Control-Allow-Headers: Content-Type, Authorization  
â†‘ å…è®¸å“ªäº›è¯·æ±‚å¤´

Access-Control-Allow-Credentials: true
â†‘ æ˜¯å¦å…è®¸å‘é€Cookieï¼ˆå…³é”®ï¼ï¼‰
```

### 3.2 CORSä¸Cookieé…ç½®


**ğŸ”§ åç«¯CORSé…ç½®ï¼ˆSpring Bootï¼‰**
```java
@Configuration
public class CorsConfig {
    
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration config = new CorsConfiguration();
        
        // å…è®¸çš„åŸŸåï¼ˆä¸èƒ½ä½¿ç”¨*å½“Allow-Credentialsä¸ºtrueæ—¶ï¼‰
        config.setAllowedOrigins(Arrays.asList(
            "http://localhost:3000",
            "https://frontend.example.com"
        ));
        
        // å…è®¸çš„æ–¹æ³•
        config.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE"));
        
        // å…è®¸çš„è¯·æ±‚å¤´
        config.setAllowedHeaders(Arrays.asList("*"));
        
        // ğŸ”‘ å…³é”®ï¼šå…è®¸å‘é€Cookie
        config.setAllowCredentials(true);
        
        // é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´
        config.setMaxAge(3600L);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);
        return source;
    }
}
```

**ğŸ’» å‰ç«¯è¯·æ±‚é…ç½®**
```javascript
// æ–¹å¼1ï¼šfetch API
fetch('http://localhost:8080/api/user', {
    method: 'GET',
    credentials: 'include',  // ğŸ”‘ å…³é”®ï¼šå‘é€Cookie
    headers: {
        'Content-Type': 'application/json'
    }
})
.then(response => response.json())
.then(data => console.log(data));

// æ–¹å¼2ï¼šaxios
axios.defaults.withCredentials = true;  // å…¨å±€é…ç½®

// æˆ–è€…å•ä¸ªè¯·æ±‚
axios.get('/api/user', {
    withCredentials: true  // ğŸ”‘ å…³é”®ï¼šå‘é€Cookie
});

// æ–¹å¼3ï¼šXMLHttpRequest
const xhr = new XMLHttpRequest();
xhr.withCredentials = true;  // ğŸ”‘ å…³é”®ï¼šå‘é€Cookie
xhr.open('GET', 'http://localhost:8080/api/user');
xhr.send();
```

### 3.3 CORSé¢„æ£€è¯·æ±‚


**ğŸ” ä»€ä¹ˆæ˜¯é¢„æ£€è¯·æ±‚**
```
é¢„æ£€è¯·æ±‚ï¼ˆPreflight Requestï¼‰ï¼š
- æµè§ˆå™¨åœ¨å‘é€æŸäº›è·¨åŸŸè¯·æ±‚å‰ï¼Œå…ˆå‘é€OPTIONSè¯·æ±‚
- è¯¢é—®æœåŠ¡å™¨ï¼š"æˆ‘èƒ½å‘é€è¿™ä¸ªè¯·æ±‚å—ï¼Ÿ"
- æœåŠ¡å™¨å›ç­”ï¼š"å¯ä»¥ï¼Œè¿™äº›æ–¹æ³•å’Œå¤´éƒ¨éƒ½å…è®¸"

è§¦å‘é¢„æ£€çš„æ¡ä»¶ï¼š
âœ… è¯·æ±‚æ–¹æ³•æ˜¯PUTã€DELETEã€PATCH
âœ… è¯·æ±‚å¤´åŒ…å«è‡ªå®šä¹‰å­—æ®µ
âœ… Content-Typeæ˜¯application/json
```

**ğŸ“Š é¢„æ£€è¯·æ±‚æµç¨‹**
```
æµè§ˆå™¨                              æœåŠ¡å™¨
   |                                  |
   |--[1]OPTIONS /api/user----------->|  (é¢„æ£€è¯·æ±‚)
   |   Origin: http://localhost:3000  |
   |   Access-Control-Request-Method  |
   |                                  |
   |<--[2]é¢„æ£€å“åº”------------------- |
   |   Access-Control-Allow-Origin    |
   |   Access-Control-Allow-Methods   |
   |   Access-Control-Allow-Credentials|
   |                                  |
   |--[3]PUT /api/user (çœŸå®è¯·æ±‚)----->|
   |   Cookie: sessionId=abc123       |
   |                                  |
   |<--[4]ä¸šåŠ¡å“åº”-------------------|
```

---

## 4. ğŸ  å­åŸŸåSessionå…±äº«


### 4.1 å­åŸŸåå…±äº«åŸç†


**ğŸ—ï¸ åŸŸåå±‚çº§ç»“æ„**
```
åŸŸåå±‚çº§å…³ç³»ï¼š
example.com (ä¸»åŸŸå)
â”œâ”€â”€ www.example.com (å­åŸŸå)
â”œâ”€â”€ api.example.com (å­åŸŸå)  
â”œâ”€â”€ admin.example.com (å­åŸŸå)
â””â”€â”€ shop.example.com (å­åŸŸå)

ç›®æ ‡ï¼šè®©æ‰€æœ‰å­åŸŸåå…±äº«åŒä¸€ä¸ªSession
```

**ğŸ”‘ CookieåŸŸåè®¾ç½®**
```java
// ğŸ”¸ é”™è¯¯è®¾ç½®ï¼ˆä¸èƒ½è·¨å­åŸŸåï¼‰
Cookie cookie = new Cookie("sessionId", "abc123");
cookie.setDomain("www.example.com");  // åªåœ¨wwwå­åŸŸæœ‰æ•ˆ

// âœ… æ­£ç¡®è®¾ç½®ï¼ˆå¯ä»¥è·¨å­åŸŸåï¼‰
Cookie cookie = new Cookie("sessionId", "abc123");
cookie.setDomain(".example.com");     // æ³¨æ„å‰é¢çš„ç‚¹ï¼
```

### 4.2 å­åŸŸåSessionå…±äº«å®ç°


**ğŸ’» å®Œæ•´å®ç°ä»£ç **
```java
@Controller
public class SessionController {
    
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest request, 
                                   HttpServletRequest httpRequest,
                                   HttpServletResponse response) {
        
        // éªŒè¯ç”¨æˆ·
        User user = authService.authenticate(request.getUsername(), request.getPassword());
        if (user == null) {
            return ResponseEntity.status(401).body("è®¤è¯å¤±è´¥");
        }
        
        // åˆ›å»ºSession
        HttpSession session = httpRequest.getSession(true);
        session.setAttribute("user", user);
        session.setMaxInactiveInterval(3600); // 1å°æ—¶
        
        // ğŸ”‘ å…³é”®ï¼šè®¾ç½®è·¨å­åŸŸCookie
        String sessionId = session.getId();
        Cookie sessionCookie = new Cookie("JSESSIONID", sessionId);
        sessionCookie.setDomain(".example.com");  // ä¸»åŸŸåå‰åŠ ç‚¹
        sessionCookie.setPath("/");
        sessionCookie.setHttpOnly(true);
        sessionCookie.setSecure(true);  // ç”Ÿäº§ç¯å¢ƒå¿…é¡»
        sessionCookie.setMaxAge(3600);
        
        response.addCookie(sessionCookie);
        
        return ResponseEntity.ok("ç™»å½•æˆåŠŸ");
    }
}
```

**âš™ï¸ Spring Booté…ç½®**
```properties
# application.properties
# Sessioné…ç½®
server.servlet.session.cookie.domain=.example.com
server.servlet.session.cookie.path=/
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=none
server.servlet.session.timeout=1h
```

### 4.3 å­åŸŸåå…±äº«çš„é™åˆ¶


**âš ï¸ æ³¨æ„äº‹é¡¹**
```
ğŸ”¸ å®‰å…¨é™åˆ¶
- åªèƒ½åœ¨åŒä¸€ä¸»åŸŸåä¸‹å…±äº«
- example.com âœ… other.com âŒ

ğŸ”¸ Cookieæ•°é‡é™åˆ¶  
- æ¯ä¸ªåŸŸåæœ€å¤š300ä¸ªCookie
- æ¯ä¸ªCookieæœ€å¤§4KB

ğŸ”¸ æµè§ˆå™¨å…¼å®¹æ€§
- ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ
- IEéœ€è¦ç‰¹æ®Šå¤„ç†

ğŸ”¸ HTTPSè¦æ±‚
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS
- SameSite=Noneå¿…é¡»é…åˆSecure
```

---

## 5. ğŸ”„ å‰åç«¯åˆ†ç¦»æ¶æ„å¤„ç†


### 5.1 å‰åç«¯åˆ†ç¦»çš„æŒ‘æˆ˜


**ğŸ—ï¸ ä¼ ç»Ÿæ¶æ„ vs åˆ†ç¦»æ¶æ„**
```
ä¼ ç»Ÿæ¶æ„ï¼ˆåŒåŸŸåï¼‰ï¼š
å‰ç«¯ï¼šhttps://example.com/
åç«¯ï¼šhttps://example.com/api/
Cookieè‡ªåŠ¨å·¥ä½œ âœ…

åˆ†ç¦»æ¶æ„ï¼ˆä¸åŒåŸŸåï¼‰ï¼š
å‰ç«¯ï¼šhttps://frontend.com/
åç«¯ï¼šhttps://api.backend.com/
Cookieè·¨åŸŸå¤±æ•ˆ âŒ
```

**ğŸš« åˆ†ç¦»æ¶æ„çš„Sessioné—®é¢˜**
```
æ ¸å¿ƒé—®é¢˜ï¼š
1ï¸âƒ£ ä¸åŒåŸŸåå¯¼è‡´Cookieæ— æ³•å‘é€
2ï¸âƒ£ æµè§ˆå™¨å®‰å…¨ç­–ç•¥é˜»æ­¢è·¨åŸŸCookie
3ï¸âƒ£ Session IDæ— æ³•åœ¨è¯·æ±‚é—´ä¼ é€’
4ï¸âƒ£ æ¯æ¬¡è¯·æ±‚éƒ½è¢«å½“ä½œæ–°ç”¨æˆ·

è§£å†³æ€è·¯ï¼š
æ–¹æ¡ˆ1: é…ç½®è·¨åŸŸCookieï¼ˆå¤æ‚ï¼‰
æ–¹æ¡ˆ2: ä½¿ç”¨Tokenæ›¿ä»£Sessionï¼ˆæ¨èï¼‰
æ–¹æ¡ˆ3: ä»£ç†è½¬å‘ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```

### 5.2 ä»£ç†è½¬å‘è§£å†³æ–¹æ¡ˆ


**ğŸ”§ å¼€å‘ç¯å¢ƒä»£ç†é…ç½®**
```javascript
// Vue.jsé¡¹ç›®é…ç½®ï¼ˆvue.config.jsï¼‰
module.exports = {
  devServer: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',  // åç«¯åœ°å€
        changeOrigin: true,               // æ”¹å˜è¯·æ±‚å¤´ä¸­çš„Origin
        secure: false,                    // æ¥å—è‡ªç­¾åè¯ä¹¦
        cookieDomainRewrite: {           // CookieåŸŸåé‡å†™
          '*': 'localhost'
        }
      }
    }
  }
}

// å‰ç«¯è¯·æ±‚
fetch('/api/user')  // å®é™…è¯·æ±‚: http://localhost:8080/api/user
  .then(response => response.json())
  .then(data => console.log(data));
```

**ğŸŒ Nginxåå‘ä»£ç†**
```nginx
# nginx.conf
server {
    listen 80;
    server_name frontend.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/frontend;
        try_files $uri $uri/ /index.html;
    }
    
    # APIä»£ç†åˆ°åç«¯
    location /api/ {
        proxy_pass http://backend.com:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # ğŸ”‘ å…³é”®ï¼šä¿æŒCookie
        proxy_cookie_domain backend.com frontend.com;
        proxy_cookie_path / /;
    }
}
```

### 5.3 Tokenæ–¹æ¡ˆæ›¿ä»£Session


**ğŸ¯ ä¸ºä»€ä¹ˆæ¨èToken**
```
Tokenæ–¹æ¡ˆä¼˜åŠ¿ï¼š
âœ… å¤©ç„¶æ”¯æŒè·¨åŸŸ
âœ… æ— çŠ¶æ€ï¼Œæ˜“äºæ‰©å±•  
âœ… ç§»åŠ¨ç«¯å‹å¥½
âœ… ä¸ä¾èµ–Cookie

Token vs Sessionå¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç‰¹æ€§     â”‚   Session   â”‚    Token    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è·¨åŸŸæ”¯æŒ   â”‚     âŒ      â”‚     âœ…      â”‚
â”‚  å­˜å‚¨ä½ç½®   â”‚  æœåŠ¡å™¨ç«¯   â”‚   å®¢æˆ·ç«¯    â”‚
â”‚  æ‰©å±•æ€§     â”‚     å·®      â”‚     å¥½      â”‚
â”‚  ç§»åŠ¨ç«¯     â”‚   å¤æ‚      â”‚    ç®€å•     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’» Tokenå®ç°ç¤ºä¾‹**
```javascript
// å‰ç«¯Tokenå¤„ç†
class AuthService {
    login(username, password) {
        return fetch('/api/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.token) {
                // å­˜å‚¨Tokenï¼ˆlocalStorage/sessionStorageï¼‰
                localStorage.setItem('token', data.token);
                return true;
            }
            return false;
        });
    }
    
    // åœ¨è¯·æ±‚ä¸­æ·»åŠ Token
    apiRequest(url, options = {}) {
        const token = localStorage.getItem('token');
        return fetch(url, {
            ...options,
            headers: {
                ...options.headers,
                'Authorization': `Bearer ${token}`  // ğŸ”‘ å…³é”®
            }
        });
    }
    
    logout() {
        localStorage.removeItem('token');
    }
}
```

---

## 6. ğŸ”Œ APIæ¥å£è®¤è¯å¤„ç†


### 6.1 APIè®¤è¯çš„ç‰¹ç‚¹


**ğŸ”„ APIæ¥å£è®¤è¯æµç¨‹**
```
å®¢æˆ·ç«¯                           APIæœåŠ¡å™¨
   |                                |
   |--[1]POST /api/auth/login------>|
   |   {username, password}         |
   |                                |--[2]éªŒè¯ç”¨æˆ·ä¿¡æ¯
   |<--[3]è¿”å›è®¤è¯ä¿¡æ¯--------------|   
   |   Set-Cookie: token=xxx        |   æˆ–JSON: {token: xxx}
   |                                |
   |--[4]GET /api/user------------->|
   |   Cookie: token=xxx            |   æˆ–Header: Authorization: Bearer xxx
   |   æˆ–Authorization: Bearer xxx  |
   |                                |--[5]éªŒè¯token
   |<--[6]è¿”å›ç”¨æˆ·æ•°æ®--------------|
```

**ğŸ“‹ APIè®¤è¯æ–¹å¼å¯¹æ¯”**
```
ğŸ”¸ Cookieæ–¹å¼
ä¼˜ç‚¹ï¼šè‡ªåŠ¨å‘é€ï¼Œç®€å•
ç¼ºç‚¹ï¼šè·¨åŸŸå¤æ‚ï¼ŒCSRFé£é™©

ğŸ”¸ Headeræ–¹å¼  
ä¼˜ç‚¹ï¼šè·¨åŸŸå‹å¥½ï¼Œå®‰å…¨
ç¼ºç‚¹ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†

ğŸ”¸ Queryå‚æ•°æ–¹å¼
ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥
ç¼ºç‚¹ï¼šä¸å®‰å…¨ï¼Œä¼šè¢«è®°å½•æ—¥å¿—
```

### 6.2 RESTful APIè®¤è¯å®ç°


**ğŸ’» åç«¯APIè®¤è¯å®ç°**
```java
@RestController
@RequestMapping("/api")
public class ApiController {
    
    @Autowired
    private TokenService tokenService;
    
    // APIç™»å½•æ¥å£
    @PostMapping("/auth/login")
    public ResponseEntity<?> apiLogin(@RequestBody LoginRequest request) {
        User user = authService.authenticate(request.getUsername(), request.getPassword());
        if (user == null) {
            return ResponseEntity.status(401).body(Map.of("error", "è®¤è¯å¤±è´¥"));
        }
        
        // ç”ŸæˆToken
        String token = tokenService.generateToken(user);
        
        // è¿”å›Tokenï¼ˆä¸¤ç§æ–¹å¼ï¼‰
        return ResponseEntity.ok()
            .header("Set-Cookie", "token=" + token + "; HttpOnly; Secure; SameSite=None")
            .body(Map.of("token", token, "user", user));
    }
    
    // éœ€è¦è®¤è¯çš„APIæ¥å£
    @GetMapping("/user/profile")
    public ResponseEntity<?> getUserProfile(HttpServletRequest request) {
        // ä»Cookieæˆ–Headerè·å–Token
        String token = extractToken(request);
        
        if (token == null || !tokenService.validateToken(token)) {
            return ResponseEntity.status(401).body(Map.of("error", "æœªæˆæƒ"));
        }
        
        User user = tokenService.getUserFromToken(token);
        return ResponseEntity.ok(user);
    }
    
    // Tokenæå–é€»è¾‘
    private String extractToken(HttpServletRequest request) {
        // æ–¹å¼1ï¼šä»Authorization Headerè·å–
        String authHeader = request.getHeader("Authorization");
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            return authHeader.substring(7);
        }
        
        // æ–¹å¼2ï¼šä»Cookieè·å–
        Cookie[] cookies = request.getCookies();
        if (cookies != null) {
            for (Cookie cookie : cookies) {
                if ("token".equals(cookie.getName())) {
                    return cookie.getValue();
                }
            }
        }
        
        // æ–¹å¼3ï¼šä»Queryå‚æ•°è·å–ï¼ˆä¸æ¨èï¼‰
        return request.getParameter("token");
    }
}
```

### 6.3 APIè®¤è¯ä¸­é—´ä»¶


**ğŸ”§ å…¨å±€è®¤è¯æ‹¦æˆªå™¨**
```java
@Component
public class ApiAuthInterceptor implements HandlerInterceptor {
    
    @Autowired
    private TokenService tokenService;
    
    // æ— éœ€è®¤è¯çš„æ¥å£
    private static final Set<String> PUBLIC_PATHS = Set.of(
        "/api/auth/login",
        "/api/auth/register", 
        "/api/public/"
    );
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) throws Exception {
        
        String path = request.getRequestURI();
        
        // å…¬å¼€æ¥å£ç›´æ¥æ”¾è¡Œ
        if (isPublicPath(path)) {
            return true;
        }
        
        // æå–å’ŒéªŒè¯Token
        String token = extractToken(request);
        if (token == null || !tokenService.validateToken(token)) {
            response.setStatus(401);
            response.setContentType("application/json;charset=UTF-8");
            response.getWriter().write("{\"error\":\"æœªæˆæƒè®¿é—®\"}");
            return false;
        }
        
        // å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°è¯·æ±‚ä¸­
        User user = tokenService.getUserFromToken(token);
        request.setAttribute("currentUser", user);
        
        return true;
    }
    
    private boolean isPublicPath(String path) {
        return PUBLIC_PATHS.stream().anyMatch(path::startsWith);
    }
}
```

---

## 7. ğŸ“± ç§»åŠ¨ç«¯WebViewä¸­çš„Cookie


### 7.1 WebView Cookieç‰¹ç‚¹


**ğŸ“± ç§»åŠ¨ç«¯WebViewçš„Cookieé—®é¢˜**
```
WebViewç¯å¢ƒç‰¹ç‚¹ï¼š
ğŸ”¸ ä¸æ˜¯å®Œæ•´çš„æµè§ˆå™¨ç¯å¢ƒ
ğŸ”¸ Cookieç®¡ç†æœºåˆ¶å¯èƒ½ä¸åŒ
ğŸ”¸ åŒæºç­–ç•¥æ‰§è¡Œå¯èƒ½æœ‰å·®å¼‚
ğŸ”¸ ç½‘ç»œè¯·æ±‚å¯èƒ½è¢«åŸç”Ÿä»£ç†

å¸¸è§é—®é¢˜ï¼š
âŒ Cookieè®¾ç½®åä¸¢å¤±
âŒ è·¨åŸŸCookieæ— æ³•å·¥ä½œ  
âŒ Sessionè®¤è¯å¤±æ•ˆ
âŒ ç™»å½•çŠ¶æ€æ— æ³•ä¿æŒ
```

**ğŸ”„ WebViewä¸æµè§ˆå™¨å·®å¼‚**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ç‰¹æ€§       â”‚   æµè§ˆå™¨    â”‚   WebView   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Cookieå­˜å‚¨     â”‚    ç¨³å®š     â”‚   å¯èƒ½ä¸¢å¤±  â”‚
â”‚  è·¨åŸŸè¯·æ±‚       â”‚  ä¸¥æ ¼é™åˆ¶   â”‚   ç›¸å¯¹å®½æ¾  â”‚
â”‚  SessionæŒä¹…åŒ–  â”‚    æ­£å¸¸     â”‚   å¯èƒ½å¼‚å¸¸  â”‚
â”‚  å¼€å‘è€…å·¥å…·     â”‚    å®Œæ•´     â”‚    å—é™    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 WebView Cookieè§£å†³æ–¹æ¡ˆ


**ğŸ”§ Android WebViewé…ç½®**
```java
// Android WebView Cookieè®¾ç½®
public class WebViewActivity extends AppCompatActivity {
    
    private WebView webView;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        webView = findViewById(R.id.webview);
        
        // ğŸ”‘ å…³é”®ï¼šå¯ç”¨Cookie
        CookieManager cookieManager = CookieManager.getInstance();
        cookieManager.setAcceptCookie(true);
        cookieManager.setAcceptThirdPartyCookies(webView, true);
        
        // WebViewè®¾ç½®
        WebSettings settings = webView.getSettings();
        settings.setJavaScriptEnabled(true);
        settings.setDomStorageEnabled(true);
        settings.setDatabaseEnabled(true);
        
        // æ¸…é™¤ç¼“å­˜ï¼ˆå¼€å‘æ—¶ï¼‰
        webView.clearCache(true);
        cookieManager.removeAllCookies(null);
        
        webView.loadUrl("https://yourapp.com");
    }
    
    // æ‰‹åŠ¨è®¾ç½®Cookie
    private void setCookie(String url, String cookieString) {
        CookieManager cookieManager = CookieManager.getInstance();
        cookieManager.setCookie(url, cookieString);
        cookieManager.flush(); // å¼ºåˆ¶åŒæ­¥
    }
}
```

**ğŸ iOS WebViewé…ç½®**
```swift
// iOS WKWebView Cookieè®¾ç½®
import WebKit

class WebViewController: UIViewController {
    
    var webView: WKWebView!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        // åˆ›å»ºWebViewé…ç½®
        let config = WKWebViewConfiguration()
        
        // ğŸ”‘ å…³é”®ï¼šå¯ç”¨Cookie
        config.websiteDataStore = WKWebsiteDataStore.default()
        
        webView = WKWebView(frame: view.bounds, configuration: config)
        view.addSubview(webView)
        
        // æ‰‹åŠ¨è®¾ç½®Cookie
        setCookie()
        
        let url = URL(string: "https://yourapp.com")!
        webView.load(URLRequest(url: url))
    }
    
    // æ‰‹åŠ¨è®¾ç½®Cookie
    func setCookie() {
        let cookie = HTTPCookie(properties: [
            .domain: "yourapp.com",
            .path: "/",
            .name: "sessionId", 
            .value: "abc123",
            .secure: "TRUE",
            .expires: NSDate(timeIntervalSinceNow: 3600)
        ])!
        
        webView.configuration.websiteDataStore.httpCookieStore.setCookie(cookie)
    }
}
```

### 7.3 WebViewè®¤è¯æœ€ä½³å®è·µ


**ğŸ¯ æ¨èæ–¹æ¡ˆï¼šåŸç”ŸToken + WebView**
```javascript
// æ··åˆå¼€å‘æœ€ä½³å®è·µ

// 1. åŸç”ŸAppå…ˆè¿›è¡Œè®¤è¯
// 2. è·å–Tokenåä¼ é€’ç»™WebView
// 3. WebViewä½¿ç”¨Tokenè¿›è¡ŒAPIè°ƒç”¨

class HybridAuth {
    constructor() {
        // ä»åŸç”ŸAppè·å–Token
        this.token = this.getTokenFromNative();
    }
    
    // ä»åŸç”Ÿè·å–Token
    getTokenFromNative() {
        // Android
        if (window.Android && window.Android.getToken) {
            return window.Android.getToken();
        }
        
        // iOS  
        if (window.webkit && window.webkit.messageHandlers.getToken) {
            window.webkit.messageHandlers.getToken.postMessage({});
        }
        
        // é™çº§æ–¹æ¡ˆï¼šä»URLå‚æ•°è·å–
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('token');
    }
    
    // æ‰€æœ‰APIè¯·æ±‚éƒ½å¸¦ä¸ŠToken
    async apiRequest(url, options = {}) {
        return fetch(url, {
            ...options,
            headers: {
                ...options.headers,
                'Authorization': `Bearer ${this.token}`
            }
        });
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const auth = new HybridAuth();
auth.apiRequest('/api/user/profile')
    .then(response => response.json())
    .then(user => {
        console.log('ç”¨æˆ·ä¿¡æ¯:', user);
    });
```

**âš ï¸ WebViewå¼€å‘æ³¨æ„äº‹é¡¹**
```
ğŸ”¸ CookieåŒæ­¥
- åŠæ—¶è°ƒç”¨flush()æ–¹æ³•
- ç›‘å¬Cookieå˜åŒ–äº‹ä»¶

ğŸ”¸ ç”Ÿå‘½å‘¨æœŸç®¡ç†
- Appåˆ‡æ¢æ—¶ä¿å­˜çŠ¶æ€
- å†…å­˜è­¦å‘Šæ—¶æ¸…ç†èµ„æº

ğŸ”¸ å®‰å…¨è€ƒè™‘
- éªŒè¯WebViewåŠ è½½çš„URL
- é™åˆ¶JavaScriptæƒé™
- é˜²æ­¢æ¶æ„ç½‘ç«™æ”»å‡»

ğŸ”¸ æ€§èƒ½ä¼˜åŒ–
- åˆç†ä½¿ç”¨ç¼“å­˜
- é¿å…é¢‘ç¹åˆ›å»ºWebView
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 è·¨åŸŸé—®é¢˜æ ¸å¿ƒç†è§£


```
ğŸ”¸ è·¨åŸŸæœ¬è´¨ï¼šæµè§ˆå™¨çš„å®‰å…¨ä¿æŠ¤æœºåˆ¶ï¼Œé˜²æ­¢æ¶æ„ç½‘ç«™æ”»å‡»
ğŸ”¸ å½±å“èŒƒå›´ï¼šCookieæ— æ³•è·¨åŸŸå‘é€ï¼ŒSessionè®¤è¯å¤±æ•ˆ
ğŸ”¸ è§£å†³æ€è·¯ï¼šé…ç½®CORS + SameSite=None + Secure + credentials
ğŸ”¸ æœ€ä½³å®è·µï¼šç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨Tokenæ›¿ä»£Session
```

### 8.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”§ åç«¯é…ç½®æ¸…å•**
```
âœ… CORSé…ç½®ï¼šå…è®¸ç‰¹å®šåŸŸåï¼Œä¸èƒ½ä½¿ç”¨*
âœ… Allow-Credentials: trueï¼ˆå…è®¸å‘é€Cookieï¼‰
âœ… Cookieè®¾ç½®ï¼šSameSite=None; Secure; HttpOnly  
âœ… åŸŸåè®¾ç½®ï¼šå­åŸŸåå…±äº«ç”¨.example.com
âœ… HTTPSéƒ¨ç½²ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS
```

**ğŸ’» å‰ç«¯é…ç½®æ¸…å•**
```
âœ… credentials: 'include'ï¼ˆfetch/axiosé…ç½®ï¼‰
âœ… withCredentials: trueï¼ˆXMLHttpRequesté…ç½®ï¼‰
âœ… ä»£ç†é…ç½®ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨proxyé¿å…è·¨åŸŸ
âœ… Tokenå­˜å‚¨ï¼šæ¨èlocalStorage + Authorization Header
âœ… é”™è¯¯å¤„ç†ï¼š401çŠ¶æ€ç è‡ªåŠ¨è·³è½¬ç™»å½•
```

### 8.3 ä¸åŒåœºæ™¯é€‰æ‹©ç­–ç•¥


**ğŸ¯ åœºæ™¯é€‰æ‹©æŒ‡å—**
```
ğŸ“± ç§»åŠ¨ç«¯WebView:
æ¨èï¼šåŸç”ŸToken + WebViewæ¥æ”¶
é¿å…ï¼šå¤æ‚çš„Cookieè·¨åŸŸé…ç½®

ğŸŒ å‰åç«¯åˆ†ç¦»:
æ¨èï¼šJWT Token + Authorization Header  
é¿å…ï¼šå¤æ‚çš„CORS Cookieé…ç½®

ğŸ¢ ä¼ä¸šå†…ç½‘:
å¯é€‰ï¼šSession + å­åŸŸåå…±äº«
å¯é€‰ï¼šä»£ç†è½¬å‘ç»Ÿä¸€åŸŸå

ğŸ”Œ APIæ¥å£:
æ¨èï¼šTokenè®¤è¯ + RESTfulè®¾è®¡
é¿å…ï¼šSessionçŠ¶æ€ä¾èµ–
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**â“ ä¸ºä»€ä¹ˆCookieè®¾ç½®äº†ä½†ä¸ç”Ÿæ•ˆï¼Ÿ**
```
æ£€æŸ¥æ¸…å•ï¼š
1ï¸âƒ£ æ˜¯å¦é…ç½®äº†SameSite=None
2ï¸âƒ£ æ˜¯å¦åŒæ—¶è®¾ç½®äº†Secure=true  
3ï¸âƒ£ æ˜¯å¦ä½¿ç”¨HTTPSåè®®
4ï¸âƒ£ å‰ç«¯æ˜¯å¦é…ç½®credentials: 'include'
5ï¸âƒ£ åç«¯æ˜¯å¦è®¾ç½®Allow-Credentials: true
```

**â“ ä¸ºä»€ä¹ˆå­åŸŸåæ— æ³•å…±äº«Sessionï¼Ÿ**
```
æ£€æŸ¥æ¸…å•ï¼š
1ï¸âƒ£ CookieåŸŸåæ˜¯å¦è®¾ç½®ä¸º.example.com
2ï¸âƒ£ è·¯å¾„æ˜¯å¦è®¾ç½®ä¸º/
3ï¸âƒ£ å„å­åŸŸåæ˜¯å¦ä½¿ç”¨ç›¸åŒçš„Sessionå­˜å‚¨
4ï¸âƒ£ æ˜¯å¦åœ¨åŒä¸€ä¸ªä¸»åŸŸåä¸‹
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- è·¨åŸŸCookieéœ€è¦å››ä¸ªæ¡ä»¶ï¼šSameSite=None + Secure + CORS + credentials
- å‰åç«¯åˆ†ç¦»æ¨èTokenæ–¹æ¡ˆï¼Œç®€å•å¯é 
- ç§»åŠ¨ç«¯WebViewå»ºè®®åŸç”Ÿè®¤è¯ + Tokenä¼ é€’
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPSï¼Œå¼€å‘ç¯å¢ƒå¯ä»¥ç”¨ä»£ç†