---
title: 4ã€JWTç¼–ç ä¸æ•°æ®ç»„æˆ
---
## ğŸ“š ç›®å½•

1. [JWTåŸºç¡€æ¦‚å¿µå›é¡¾](#1-jwtåŸºç¡€æ¦‚å¿µå›é¡¾)
2. [Base64URLç¼–ç è§„åˆ™è¯¦è§£](#2-base64urlç¼–ç è§„åˆ™è¯¦è§£)
3. [Headerè¯¦ç»†è§£æ](#3-headerè¯¦ç»†è§£æ)
4. [Payloadè½½è·æ·±åº¦å‰–æ](#4-payloadè½½è·æ·±åº¦å‰–æ)
5. [Signatureç­¾åæœºåˆ¶](#5-signatureç­¾åæœºåˆ¶)
6. [JWTå®Œæ•´ç¤ºä¾‹åˆ†æ](#6-jwtå®Œæ•´ç¤ºä¾‹åˆ†æ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ JWTåŸºç¡€æ¦‚å¿µå›é¡¾


### 1.1 ä»€ä¹ˆæ˜¯JWT

**JWTï¼ˆJSON Web Tokenï¼‰** å°±åƒæ˜¯ä¸€å¼ **æ•°å­—èº«ä»½è¯**ï¼Œå®ƒç”¨æ¥è¯æ˜"ä½ æ˜¯è°"å’Œ"ä½ èƒ½åšä»€ä¹ˆ"ã€‚

```
æƒ³è±¡åœºæ™¯ï¼š
ä½ å»é“¶è¡ŒåŠä¸šåŠ¡ï¼Œéœ€è¦å‡ºç¤ºèº«ä»½è¯
èº«ä»½è¯åŒ…å«ï¼šå§“åã€èº«ä»½è¯å·ã€æœ‰æ•ˆæœŸç­‰ä¿¡æ¯
JWTä¹Ÿç±»ä¼¼ï¼ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œæƒé™ä¿¡æ¯

åŒºåˆ«ï¼š
èº«ä»½è¯æ˜¯å¡‘æ–™å¡ç‰‡ â†’ JWTæ˜¯ä¸€ä¸²å­—ç¬¦
èº«ä»½è¯æœ‰é˜²ä¼ªæ ‡è¯† â†’ JWTæœ‰æ•°å­—ç­¾å
```

### 1.2 JWTçš„åŸºæœ¬ç»“æ„

JWTç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œç”¨ **ç‚¹å·(.)** åˆ†éš”ï¼š

```
JWT = Header.Payload.Signature

å®é™…ä¾‹å­ï¼š
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c

åˆ†è§£ï¼š
Header:    eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
Payload:   eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ
Signature: SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦ä¸‰ä¸ªéƒ¨åˆ†


| éƒ¨åˆ† | ä½œç”¨ | ç±»æ¯” |
|------|------|------|
| **Header** | è¯´æ˜ä½¿ç”¨ä»€ä¹ˆç®—æ³• | èº«ä»½è¯ä¸Šçš„"é˜²ä¼ªæŠ€æœ¯è¯´æ˜" |
| **Payload** | å­˜æ”¾å®é™…æ•°æ® | èº«ä»½è¯ä¸Šçš„ä¸ªäººä¿¡æ¯ |
| **Signature** | é˜²æ­¢ç¯¡æ”¹ | èº«ä»½è¯ä¸Šçš„é˜²ä¼ªæ ‡è¯† |

---

## 2. ğŸ”¤ Base64URLç¼–ç è§„åˆ™è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯Base64URLç¼–ç 

**Base64URL** æ˜¯JWTä¸“ç”¨çš„ç¼–ç æ–¹å¼ï¼Œå®ƒæ˜¯ **Base64ç¼–ç çš„URLå®‰å…¨ç‰ˆæœ¬**ã€‚

```
ä¸ºä»€ä¹ˆéœ€è¦ç¼–ç ï¼Ÿ
åŸå§‹æ•°æ®æ˜¯JSONæ ¼å¼ â†’ {"alg":"HS256","typ":"JWT"}
JSONåœ¨URLä¸­ä¸å®‰å…¨ â†’ åŒ…å«ç‰¹æ®Šå­—ç¬¦ { } " :
éœ€è¦ç¼–ç æˆå®‰å…¨å­—ç¬¦ â†’ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
```

### 2.2 Base64 vs Base64URL åŒºåˆ«


| ç‰¹å¾ | Base64 | Base64URL | è¯´æ˜ |
|------|--------|-----------|------|
| **å­—ç¬¦é›†** | `A-Z, a-z, 0-9, +, /` | `A-Z, a-z, 0-9, -, _` | URLå®‰å…¨å­—ç¬¦ |
| **å¡«å……ç¬¦** | `=` | å»æ‰ | é¿å…URLå‚æ•°é—®é¢˜ |
| **URLå®‰å…¨** | âŒ | âœ… | å¯ç›´æ¥ç”¨äºURL |

```
Base64ç¼–ç ï¼š    eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9==
Base64URLç¼–ç ï¼š eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

åŒºåˆ«ï¼š
1. å»æ‰äº†æœ«å°¾çš„ == å¡«å……ç¬¦
2. å¦‚æœæœ‰ + ä¼šå˜æˆ -
3. å¦‚æœæœ‰ / ä¼šå˜æˆ _
```

### 2.3 ç¼–ç è§£ç è¿‡ç¨‹æ¼”ç¤º


```javascript
// ç¼–ç è¿‡ç¨‹æ¼”ç¤º
const headerObj = {"alg":"HS256","typ":"JWT"};

// æ­¥éª¤1ï¼šJSONå¯¹è±¡è½¬å­—ç¬¦ä¸²
const headerStr = JSON.stringify(headerObj);
// ç»“æœï¼š{"alg":"HS256","typ":"JWT"}

// æ­¥éª¤2ï¼šè½¬æ¢ä¸ºBase64URL
const headerEncoded = btoa(headerStr)
  .replace(/\+/g, '-')
  .replace(/\//g, '_')
  .replace(/=/g, '');
// ç»“æœï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

// è§£ç è¿‡ç¨‹ï¼ˆç›¸åï¼‰
const decoded = JSON.parse(atob(headerEncoded));
console.log(decoded); // {"alg":"HS256","typ":"JWT"}
```

> **ğŸ’¡ å…³é”®ç†è§£**ï¼šBase64URLç¼–ç è®©JSONæ•°æ®å˜æˆURLå®‰å…¨çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·JWTå°±èƒ½åœ¨ç½‘ç»œä¸­å®‰å…¨ä¼ è¾“äº†ï¼

---

## 3. ğŸ·ï¸ Headerè¯¦ç»†è§£æ


### 3.1 Headerçš„ä½œç”¨å’Œç»“æ„

**Headerï¼ˆå¤´éƒ¨ï¼‰** å°±åƒæ˜¯JWTçš„"**ä½¿ç”¨è¯´æ˜ä¹¦**"ï¼Œå‘Šè¯‰åˆ«äººè¿™ä¸ªJWTç”¨ä»€ä¹ˆæ–¹å¼åˆ¶ä½œçš„ã€‚

```
HeaderåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒä¿¡æ¯ï¼š
1. algï¼ˆAlgorithmï¼‰ï¼šä½¿ç”¨ä»€ä¹ˆç®—æ³•ç­¾å
2. typï¼ˆTypeï¼‰ï¼šä»¤ç‰Œç±»å‹ï¼ˆå›ºå®šæ˜¯"JWT"ï¼‰

æ ‡å‡†ç»“æ„ï¼š
{
  "alg": "HS256",    // ç­¾åç®—æ³•
  "typ": "JWT"       // ä»¤ç‰Œç±»å‹
}
```

### 3.2 algå­—æ®µè¯¦è§£


**alg** è¡¨ç¤º**ç­¾åç®—æ³•**ï¼Œå‘Šè¯‰æ¥æ”¶æ–¹ç”¨ä»€ä¹ˆç®—æ³•éªŒè¯JWTçš„çœŸå®æ€§ã€‚

| ç®—æ³•ç±»å‹ | ç®—æ³•åç§° | è¯´æ˜ | å®‰å…¨æ€§ |
|---------|---------|------|--------|
| **å¯¹ç§°åŠ å¯†** | `HS256` | HMAC + SHA256ï¼Œé€Ÿåº¦å¿« | â­â­â­ |
| **å¯¹ç§°åŠ å¯†** | `HS512` | HMAC + SHA512ï¼Œæ›´å®‰å…¨ | â­â­â­â­ |
| **éå¯¹ç§°åŠ å¯†** | `RS256` | RSA + SHA256ï¼Œå…¬ç§é’¥ | â­â­â­â­â­ |
| **éå¯¹ç§°åŠ å¯†** | `ES256` | ECDSA + SHA256ï¼Œæ•ˆç‡é«˜ | â­â­â­â­â­ |
| **æ— ç­¾å** | `none` | ä¸ç­¾åï¼Œ**æä¸å®‰å…¨** | â­ |

```javascript
// ä¸åŒç®—æ³•çš„Headerç¤ºä¾‹
const hsHeader = {"alg": "HS256", "typ": "JWT"};  // å¯¹ç§°åŠ å¯†
const rsHeader = {"alg": "RS256", "typ": "JWT"};  // éå¯¹ç§°åŠ å¯†
const noHeader = {"alg": "none", "typ": "JWT"};   // æ— ç­¾åï¼ˆå±é™©ï¼ï¼‰
```

### 3.3 typå­—æ®µè¯¦è§£


**typ** è¡¨ç¤º**ä»¤ç‰Œç±»å‹**ï¼Œå¯¹äºJWTæ¥è¯´è¿™ä¸ªå€¼**å›ºå®šæ˜¯ "JWT"**ã€‚

```
ä¸ºä»€ä¹ˆéœ€è¦typå­—æ®µï¼Ÿ
1. æ˜ç¡®æ ‡è¯†è¿™æ˜¯JWTè€Œä¸æ˜¯å…¶ä»–ç±»å‹çš„token
2. æ–¹ä¾¿ç³»ç»Ÿè¯†åˆ«å’Œå¤„ç†
3. ç¬¦åˆJWTæ ‡å‡†è§„èŒƒ

å®é™…ä¸Šï¼Œtypå­—æ®µæ˜¯å¯é€‰çš„ï¼Œä½†å»ºè®®æ€»æ˜¯åŒ…å«
```

### 3.4 Headeræ‰©å±•å­—æ®µï¼ˆäº†è§£å³å¯ï¼‰


é™¤äº†æ ‡å‡†å­—æ®µï¼ŒHeaderè¿˜å¯ä»¥åŒ…å«ä¸€äº›æ‰©å±•å­—æ®µï¼š

```javascript
{
  "alg": "RS256",
  "typ": "JWT",
  "kid": "key-1",        // Key IDï¼šå½“æœ‰å¤šä¸ªå¯†é’¥æ—¶æ ‡è¯†ä½¿ç”¨å“ªä¸ª
  "cty": "JWT"           // Content Typeï¼šå†…å®¹ç±»å‹
}
```

> **âš ï¸ é‡è¦æé†’**ï¼šHeaderä¿¡æ¯æ˜¯**å…¬å¼€**çš„ï¼Œä»»ä½•äººéƒ½èƒ½è§£ç æŸ¥çœ‹ï¼Œæ‰€ä»¥ä¸è¦åœ¨Headerä¸­æ”¾æ•æ„Ÿä¿¡æ¯ï¼

---

## 4. ğŸ“¦ Payloadè½½è·æ·±åº¦å‰–æ


### 4.1 Payloadæ˜¯ä»€ä¹ˆ

**Payloadï¼ˆè½½è·ï¼‰** å°±åƒæ˜¯JWTçš„"**æ ¸å¿ƒå†…å®¹**"ï¼Œå­˜æ”¾ç€æˆ‘ä»¬çœŸæ­£å…³å¿ƒçš„æ•°æ®ã€‚

```
ç±»æ¯”ç†è§£ï¼š
å¿«é€’åŒ…è£¹ = JWT
åŒ…è£¹é‡Œçš„ä¸œè¥¿ = Payload
æ”¶ä»¶äººä¿¡æ¯æ ‡ç­¾ = Header
é˜²ä¼ªå°æ¡ = Signature

Payloadå­˜æ”¾çš„å†…å®¹ï¼š
- ç”¨æˆ·ä¿¡æ¯ï¼šç”¨æˆ·IDã€ç”¨æˆ·åç­‰
- æƒé™ä¿¡æ¯ï¼šè§’è‰²ã€æƒé™åˆ—è¡¨ç­‰  
- æ—¶é—´ä¿¡æ¯ï¼šç­¾å‘æ—¶é—´ã€è¿‡æœŸæ—¶é—´ç­‰
- å…¶ä»–ä¸šåŠ¡æ•°æ®
```

### 4.2 å£°æ˜ï¼ˆClaimsï¼‰åˆ†ç±»è¯¦è§£


JWTçš„Payloadä¸­çš„æ•°æ®å«åš**å£°æ˜ï¼ˆClaimsï¼‰**ï¼Œåˆ†ä¸ºä¸‰å¤§ç±»ï¼š

```
å£°æ˜åˆ†ç±»å›¾ï¼š
            å£°æ˜ (Claims)
                |
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
        |       |       |
    æ³¨å†Œå£°æ˜  å…¬å…±å£°æ˜  ç§æœ‰å£°æ˜
   (Registered) (Public) (Private)
```

### 4.3 æ³¨å†Œå£°æ˜ï¼ˆRegistered Claimsï¼‰è¯¦è§£


**æ³¨å†Œå£°æ˜** æ˜¯JWTæ ‡å‡†é¢„å®šä¹‰çš„å­—æ®µï¼Œæœ‰ç‰¹å®šçš„å«ä¹‰å’Œç”¨é€”ã€‚

#### ğŸ“… æ—¶é—´ç›¸å…³å£°æ˜


| å­—æ®µ | å…¨ç§° | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|------|
| **iss** | Issuer | ç­¾å‘è€…ï¼Œè°å‘çš„è¿™ä¸ªJWT | `"auth-server"` |
| **sub** | Subject | ä¸»é¢˜ï¼Œè¿™ä¸ªJWTæ˜¯å…³äºè°çš„ | `"user123"` |
| **aud** | Audience | å—ä¼—ï¼Œè¿™ä¸ªJWTæ˜¯ç»™è°ç”¨çš„ | `"mobile-app"` |
| **exp** | Expiration Time | è¿‡æœŸæ—¶é—´ï¼Œä»€ä¹ˆæ—¶å€™å¤±æ•ˆ | `1642680000` |
| **iat** | Issued At | ç­¾å‘æ—¶é—´ï¼Œä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ | `1642593600` |
| **nbf** | Not Before | ç”Ÿæ•ˆæ—¶é—´ï¼Œä»€ä¹ˆæ—¶å€™å¼€å§‹æœ‰æ•ˆ | `1642593600` |
| **jti** | JWT ID | JWTçš„å”¯ä¸€æ ‡è¯† | `"abc123"` |

```javascript
// æ³¨å†Œå£°æ˜ç¤ºä¾‹
{
  "iss": "https://auth.myapp.com",    // æˆ‘çš„è®¤è¯æœåŠ¡å™¨ç­¾å‘
  "sub": "user_12345",                // å…³äºç”¨æˆ·12345
  "aud": "https://api.myapp.com",     // ç»™APIæœåŠ¡å™¨ä½¿ç”¨
  "exp": 1642680000,                  // 2022-01-20è¿‡æœŸ
  "iat": 1642593600,                  // 2022-01-19ç­¾å‘
  "nbf": 1642593600,                  // 2022-01-19å¼€å§‹æœ‰æ•ˆ
  "jti": "unique-jwt-id-123"          // å”¯ä¸€æ ‡è¯†
}
```

#### ğŸ• æ—¶é—´æˆ³è¯¦è§£


JWTä¸­çš„æ—¶é—´éƒ½ç”¨**Unixæ—¶é—´æˆ³**è¡¨ç¤ºï¼ˆè‡ª1970å¹´1æœˆ1æ—¥ä»¥æ¥çš„ç§’æ•°ï¼‰ï¼š

```javascript
// æ—¶é—´è½¬æ¢ç¤ºä¾‹
const now = new Date();
const exp = Math.floor(now.getTime() / 1000) + (60 * 60); // 1å°æ—¶åè¿‡æœŸ

console.log("å½“å‰æ—¶é—´:", now);
console.log("æ—¶é—´æˆ³:", Math.floor(now.getTime() / 1000));
console.log("è¿‡æœŸæ—¶é—´æˆ³:", exp);

// éªŒè¯æ˜¯å¦è¿‡æœŸ
function isExpired(exp) {
  const now = Math.floor(Date.now() / 1000);
  return now > exp;
}
```

### 4.4 å…¬å…±å£°æ˜ï¼ˆPublic Claimsï¼‰


**å…¬å…±å£°æ˜** æ˜¯å¯ä»¥åœ¨IANA JWTå£°æ˜æ³¨å†Œè¡¨ä¸­å®šä¹‰çš„å£°æ˜ï¼Œé¿å…å‘½åå†²çªã€‚

```javascript
// å…¬å…±å£°æ˜ç¤ºä¾‹ï¼ˆä¸å¸¸ç”¨ï¼Œäº†è§£å³å¯ï¼‰
{
  "name": "John Doe",
  "email": "john@example.com",
  "https://example.com/roles": ["admin", "user"]  // ä½¿ç”¨URIé¿å…å†²çª
}
```

### 4.5 ç§æœ‰å£°æ˜ï¼ˆPrivate Claimsï¼‰


**ç§æœ‰å£°æ˜** æ˜¯æˆ‘ä»¬**è‡ªå®šä¹‰**çš„å­—æ®µï¼Œå­˜æ”¾ä¸šåŠ¡ç›¸å…³çš„æ•°æ®ã€‚

```javascript
// ç§æœ‰å£°æ˜ç¤ºä¾‹ - è¿™æ˜¯æœ€å¸¸ç”¨çš„
{
  // æ³¨å†Œå£°æ˜
  "sub": "user123",
  "exp": 1642680000,
  "iat": 1642593600,
  
  // ç§æœ‰å£°æ˜ï¼ˆè‡ªå®šä¹‰ä¸šåŠ¡æ•°æ®ï¼‰
  "userId": 123,
  "username": "john_doe", 
  "role": "admin",
  "permissions": ["read", "write", "delete"],
  "department": "IT",
  "level": 5
}
```

### 4.6 Payloadè®¾è®¡æœ€ä½³å®è·µ


```javascript
// âœ… å¥½çš„Payloadè®¾è®¡
{
  // åŸºç¡€ä¿¡æ¯
  "sub": "user_123",
  "exp": 1642680000,
  "iat": 1642593600,
  
  // å…³é”®ä¸šåŠ¡ä¿¡æ¯
  "userId": 123,
  "role": "admin",
  "permissions": ["users:read", "users:write"]
}

// âŒ é¿å…çš„Payloadè®¾è®¡
{
  "sub": "user_123",
  "password": "123456",           // âŒ æ•æ„Ÿä¿¡æ¯
  "creditCard": "1234-5678",      // âŒ æœºå¯†æ•°æ®
  "fullProfile": {                // âŒ æ•°æ®è¿‡å¤š
    "address": "è¯¦ç»†åœ°å€...",
    "biography": "å¾ˆé•¿çš„ä¸ªäººç®€ä»‹...",
    // ... å¤§é‡æ•°æ®
  }
}
```

> **ğŸ”‘ æ ¸å¿ƒåŸåˆ™**ï¼š
> - åªæ”¾**å¿…è¦**çš„ä¿¡æ¯
> - ä¸æ”¾**æ•æ„Ÿ**ä¿¡æ¯ï¼ˆå¯†ç ã€å¯†é’¥ç­‰ï¼‰
> - ä¸æ”¾**è¿‡å¤š**ä¿¡æ¯ï¼ˆJWTæœ‰å¤§å°é™åˆ¶ï¼‰
> - ä¼˜å…ˆä½¿ç”¨**æ ‡å‡†å£°æ˜**

---

## 5. ğŸ” Signatureç­¾åæœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯ç­¾å

**Signatureï¼ˆç­¾åï¼‰** å°±åƒæ˜¯JWTçš„"**é˜²ä¼ªå°ç« **"ï¼Œç”¨æ¥è¯æ˜JWTæ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

```
ç°å®ç±»æ¯”ï¼š
é“¶è¡Œæ”¯ç¥¨ä¸Šçš„å°ç«  â†’ è¯æ˜æ”¯ç¥¨çœŸå®æœ‰æ•ˆ
JWTçš„ç­¾å â†’ è¯æ˜JWTå†…å®¹æ²¡æœ‰è¢«ä¿®æ”¹

å·¥ä½œåŸç†ï¼š
1. ç”¨å¯†é’¥å¯¹ Header+Payload è¿›è¡Œç­¾å
2. æ¥æ”¶æ–¹ç”¨ç›¸åŒå¯†é’¥éªŒè¯ç­¾å
3. å¦‚æœéªŒè¯é€šè¿‡ â†’ JWTæ˜¯çœŸå®çš„
4. å¦‚æœéªŒè¯å¤±è´¥ â†’ JWTè¢«ç¯¡æ”¹äº†
```

### 5.2 ç­¾åç”Ÿæˆè¿‡ç¨‹


```
ç­¾åç”Ÿæˆæ­¥éª¤ï¼š

åŸå§‹æ•°æ® â†’ ç¼–ç  â†’ ç­¾å â†’ æœ€ç»ˆJWT
    â†“        â†“      â†“        â†“
Header   Base64URL  HMAC   ç»„åˆæˆ
+     â†’  ç¼–ç     â†’ ç®—æ³• â†’ å®Œæ•´JWT
Payload              â†‘
                   å¯†é’¥
```

### 5.3 HMACç­¾åç®—æ³•è¯¦è§£ï¼ˆæœ€å¸¸ç”¨ï¼‰


**HMACï¼ˆHash-based Message Authentication Codeï¼‰** æ˜¯å¯¹ç§°åŠ å¯†ç­¾åï¼Œé€Ÿåº¦å¿«ï¼Œä½¿ç”¨ç®€å•ã€‚

```javascript
// HMAC-SHA256 ç­¾åè¿‡ç¨‹ï¼ˆä¼ªä»£ç ï¼‰
function createSignature(header, payload, secret) {
  // 1. ç¼–ç Headerå’ŒPayload
  const encodedHeader = base64urlEncode(header);
  const encodedPayload = base64urlEncode(payload);
  
  // 2. ç»„åˆæ•°æ®
  const data = encodedHeader + "." + encodedPayload;
  
  // 3. ä½¿ç”¨å¯†é’¥ç­¾å
  const signature = hmacSha256(data, secret);
  
  // 4. Base64URLç¼–ç ç­¾å
  return base64urlEncode(signature);
}

// å®é™…ä½¿ç”¨ç¤ºä¾‹
const header = {"alg": "HS256", "typ": "JWT"};
const payload = {"sub": "123", "name": "John"};
const secret = "my-secret-key";

const signature = createSignature(header, payload, secret);
```

### 5.4 ç­¾åéªŒè¯è¿‡ç¨‹


```javascript
// éªŒè¯JWTç­¾åï¼ˆä¼ªä»£ç ï¼‰
function verifyJWT(jwt, secret) {
  // 1. åˆ†å‰²JWT
  const [headerB64, payloadB64, signatureB64] = jwt.split('.');
  
  // 2. é‡æ–°è®¡ç®—ç­¾å
  const data = headerB64 + "." + payloadB64;
  const expectedSignature = hmacSha256(data, secret);
  const expectedSignatureB64 = base64urlEncode(expectedSignature);
  
  // 3. æ¯”è¾ƒç­¾å
  return signatureB64 === expectedSignatureB64;
}

// ä½¿ç”¨ç¤ºä¾‹
const jwt = "eyJ..."; // å®Œæ•´çš„JWT
const secret = "my-secret-key";

if (verifyJWT(jwt, secret)) {
  console.log("JWTæœ‰æ•ˆï¼");
} else {
  console.log("JWTæ— æ•ˆæˆ–è¢«ç¯¡æ”¹ï¼");
}
```

### 5.5 RSAç­¾åç®—æ³•ï¼ˆå…¬ç§é’¥ï¼‰


**RSA** ä½¿ç”¨å…¬ç§é’¥å¯¹ï¼Œæ›´å®‰å…¨ä½†è®¡ç®—è¾ƒæ…¢ã€‚

```javascript
// RSAç­¾åè¿‡ç¨‹
const privateKey = `-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA...
-----END RSA PRIVATE KEY-----`;

const publicKey = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0B...
-----END PUBLIC KEY-----`;

// ç­¾åï¼ˆç”¨ç§é’¥ï¼‰
function signWithRSA(data, privateKey) {
  return rsaSha256Sign(data, privateKey);
}

// éªŒè¯ï¼ˆç”¨å…¬é’¥ï¼‰
function verifyWithRSA(data, signature, publicKey) {
  return rsaSha256Verify(data, signature, publicKey);
}
```

### 5.6 ç­¾åçš„é‡è¦ä½œç”¨


| ä½œç”¨ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **é˜²ç¯¡æ”¹** | æ£€æµ‹JWTå†…å®¹æ˜¯å¦è¢«ä¿®æ”¹ | æ”»å‡»è€…ä¿®æ”¹ç”¨æˆ·æƒé™åç­¾åéªŒè¯å¤±è´¥ |
| **èº«ä»½éªŒè¯** | ç¡®è®¤JWTæ¥æºå¯ä¿¡ | åªæœ‰è®¤è¯æœåŠ¡å™¨æ‰èƒ½ç”Ÿæˆæœ‰æ•ˆç­¾å |
| **å®Œæ•´æ€§ä¿è¯** | ç¡®ä¿æ•°æ®ä¼ è¾“è¿‡ç¨‹å®Œæ•´ | ç½‘ç»œä¼ è¾“é”™è¯¯æ—¶ç­¾åéªŒè¯å¤±è´¥ |

```javascript
// æ”»å‡»ç¤ºä¾‹ï¼šç¯¡æ”¹JWT
const originalJWT = "eyJhbGci..."; // åŸå§‹JWTï¼Œrole: "user"

// æ”»å‡»è€…å°è¯•ä¿®æ”¹æƒé™
const [header, payload, signature] = originalJWT.split('.');
const decodedPayload = JSON.parse(atob(payload));

decodedPayload.role = "admin"; // è¯•å›¾ä¿®æ”¹ä¸ºç®¡ç†å‘˜

const newPayload = btoa(JSON.stringify(decodedPayload));
const tamperedJWT = header + "." + newPayload + "." + signature;

// ç»“æœï¼šç­¾åéªŒè¯å¤±è´¥ï¼Œç¯¡æ”¹è¢«å‘ç°ï¼
```

> **ğŸ›¡ï¸ å®‰å…¨æé†’**ï¼šç­¾ååªèƒ½é˜²æ­¢ç¯¡æ”¹ï¼Œä¸èƒ½é˜²æ­¢æŸ¥çœ‹ï¼JWTçš„å†…å®¹ä»»ä½•äººéƒ½èƒ½çœ‹åˆ°ï¼Œä¸è¦æ”¾æ•æ„Ÿä¿¡æ¯ã€‚

---

## 6. ğŸ” JWTå®Œæ•´ç¤ºä¾‹åˆ†æ


### 6.1 çœŸå®JWTå®Œæ•´æ‹†è§£


è®©æˆ‘ä»¬åˆ†æä¸€ä¸ªçœŸå®çš„JWTï¼š

```
å®Œæ•´JWTï¼š
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

#### ğŸ·ï¸ Headeréƒ¨åˆ†è§£ç 


```javascript
// Header (Base64URLç¼–ç )
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"

// è§£ç åï¼š
{
  "alg": "HS256",    // ä½¿ç”¨HMAC SHA256ç®—æ³•
  "typ": "JWT"       // ç±»å‹æ˜¯JWT
}
```

#### ğŸ“¦ Payloadéƒ¨åˆ†è§£ç 


```javascript
// Payload (Base64URLç¼–ç )
"eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ"

// è§£ç åï¼š
{
  "sub": "1234567890",        // ç”¨æˆ·ID
  "name": "John Doe",         // ç”¨æˆ·å
  "iat": 1516239022           // ç­¾å‘æ—¶é—´ï¼ˆ2018-01-18ï¼‰
}
```

#### ğŸ” Signatureéƒ¨åˆ†


```javascript
// Signature (Base64URLç¼–ç )
"SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"

// è¿™æ˜¯ç”¨å¯†é’¥å¯¹ Header+Payload ç­¾ååçš„ç»“æœ
// æ— æ³•ç›´æ¥è§£ç ï¼Œåªèƒ½ç”¨äºéªŒè¯
```

### 6.2 JWTç”Ÿæˆå®Œæ•´ä»£ç ç¤ºä¾‹


```javascript
// Node.js + jsonwebtokenåº“ç¤ºä¾‹
const jwt = require('jsonwebtoken');

// 1. å®šä¹‰è½½è·æ•°æ®
const payload = {
  // æ³¨å†Œå£°æ˜
  sub: "user123",                    // ç”¨æˆ·ID
  iat: Math.floor(Date.now() / 1000), // å½“å‰æ—¶é—´
  exp: Math.floor(Date.now() / 1000) + (60 * 60), // 1å°æ—¶åè¿‡æœŸ
  
  // ç§æœ‰å£°æ˜
  userId: 123,
  username: "john_doe",
  role: "admin",
  permissions: ["read", "write"]
};

// 2. å®šä¹‰å¯†é’¥
const secret = "my-super-secret-key";

// 3. ç”ŸæˆJWT
const token = jwt.sign(payload, secret, {
  algorithm: 'HS256'  // æŒ‡å®šç®—æ³•
});

console.log("ç”Ÿæˆçš„JWT:", token);
```

### 6.3 JWTéªŒè¯å®Œæ•´ä»£ç ç¤ºä¾‹


```javascript
// JWTéªŒè¯ç¤ºä¾‹
function verifyToken(token) {
  try {
    // éªŒè¯å¹¶è§£ç JWT
    const decoded = jwt.verify(token, secret);
    
    console.log("JWTéªŒè¯æˆåŠŸï¼");
    console.log("ç”¨æˆ·ID:", decoded.userId);
    console.log("ç”¨æˆ·å:", decoded.username);
    console.log("è§’è‰²:", decoded.role);
    console.log("è¿‡æœŸæ—¶é—´:", new Date(decoded.exp * 1000));
    
    return decoded;
  } catch (error) {
    if (error.name === 'TokenExpiredError') {
      console.log("JWTå·²è¿‡æœŸ");
    } else if (error.name === 'JsonWebTokenError') {
      console.log("JWTæ— æ•ˆ");
    } else {
      console.log("éªŒè¯å¤±è´¥:", error.message);
    }
    return null;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const result = verifyToken(token);
```

### 6.4 æµè§ˆå™¨ä¸­ä½¿ç”¨JWT


```javascript
// å‰ç«¯å­˜å‚¨å’Œä½¿ç”¨JWT
class AuthService {
  // å­˜å‚¨JWT
  saveToken(token) {
    localStorage.setItem('jwt_token', token);
  }
  
  // è·å–JWT
  getToken() {
    return localStorage.getItem('jwt_token');
  }
  
  // è§£æJWTè½½è·ï¼ˆä¸éªŒè¯ç­¾åï¼‰
  parseToken(token) {
    if (!token) return null;
    
    try {
      const [header, payload, signature] = token.split('.');
      return JSON.parse(atob(payload));
    } catch (error) {
      return null;
    }
  }
  
  // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
  isTokenExpired(token) {
    const payload = this.parseToken(token);
    if (!payload || !payload.exp) return true;
    
    const now = Math.floor(Date.now() / 1000);
    return payload.exp < now;
  }
  
  // å‘é€HTTPè¯·æ±‚æ—¶æºå¸¦JWT
  async apiRequest(url, options = {}) {
    const token = this.getToken();
    
    const headers = {
      'Content-Type': 'application/json',
      ...options.headers
    };
    
    if (token && !this.isTokenExpired(token)) {
      headers['Authorization'] = `Bearer ${token}`;
    }
    
    return fetch(url, {
      ...options,
      headers
    });
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const auth = new AuthService();

// ç™»å½•åä¿å­˜token
auth.saveToken("eyJhbGci...");

// APIè¯·æ±‚è‡ªåŠ¨æºå¸¦token
auth.apiRequest('/api/user/profile')
  .then(response => response.json())
  .then(data => console.log(data));
```

### 6.5 ä¸åŒåœºæ™¯çš„JWTç¤ºä¾‹


#### ğŸ”‘ ç™»å½•åœºæ™¯


```javascript
// ç”¨æˆ·ç™»å½•æˆåŠŸåçš„JWT
{
  "sub": "user_456",
  "iat": 1642593600,
  "exp": 1642680000,      // 24å°æ—¶è¿‡æœŸ
  "userId": 456,
  "username": "alice",
  "email": "alice@example.com",
  "role": "user"
}
```

#### ğŸ‘‘ ç®¡ç†å‘˜åœºæ™¯


```javascript
// ç®¡ç†å‘˜æƒé™çš„JWT
{
  "sub": "admin_789",
  "iat": 1642593600,
  "exp": 1642597200,      // 1å°æ—¶è¿‡æœŸï¼ˆæƒé™æ›´é«˜ï¼Œè¿‡æœŸæ›´å¿«ï¼‰
  "userId": 789,
  "username": "admin",
  "role": "admin",
  "permissions": [
    "users:create",
    "users:read", 
    "users:update",
    "users:delete",
    "system:config"
  ]
}
```

#### ğŸ“± ç§»åŠ¨åº”ç”¨åœºæ™¯


```javascript
// ç§»åŠ¨åº”ç”¨çš„JWTï¼ˆè¾ƒé•¿è¿‡æœŸæ—¶é—´ï¼‰
{
  "sub": "mobile_user_123",
  "iat": 1642593600,
  "exp": 1645185600,      // 30å¤©è¿‡æœŸ
  "userId": 123,
  "deviceId": "iPhone12_ABC123",
  "appVersion": "1.2.0",
  "role": "user"
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ JWTç»“æ„ï¼šHeader.Payload.Signature ä¸‰éƒ¨åˆ†
ğŸ”¸ Base64URLç¼–ç ï¼šURLå®‰å…¨çš„ç¼–ç æ–¹å¼
ğŸ”¸ Headerï¼šç®—æ³•å£°æ˜ï¼Œé€šå¸¸æ˜¯ {"alg":"HS256","typ":"JWT"}
ğŸ”¸ Payloadï¼šå®é™…æ•°æ®ï¼Œåˆ†ä¸ºæ³¨å†Œå£°æ˜ã€å…¬å…±å£°æ˜ã€ç§æœ‰å£°æ˜
ğŸ”¸ Signatureï¼šé˜²ç¯¡æ”¹ç­¾åï¼Œä¿è¯JWTå®Œæ•´æ€§
ğŸ”¸ æ—¶é—´æˆ³ï¼šUnixæ—¶é—´æˆ³ï¼Œç”¨äºè¿‡æœŸæ§åˆ¶
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç¼–ç ä¸ç­‰äºåŠ å¯†**
```
Base64URLç¼–ç  â‰  åŠ å¯†
- ä»»ä½•äººéƒ½èƒ½è§£ç æŸ¥çœ‹Headerå’ŒPayloadå†…å®¹
- ç­¾åæ‰æ˜¯å®‰å…¨ä¿éšœï¼Œé˜²æ­¢ç¯¡æ”¹
- æ•æ„Ÿä¿¡æ¯ä¸è¦æ”¾åœ¨JWTä¸­
```

**ğŸ”¹ æ ‡å‡†å£°æ˜çš„é‡è¦æ€§**
```
å¿…ç”¨å­—æ®µï¼š
- subï¼šç”¨æˆ·æ ‡è¯†
- expï¼šè¿‡æœŸæ—¶é—´
- iatï¼šç­¾å‘æ—¶é—´

å¸¸ç”¨å­—æ®µï¼š
- issï¼šç­¾å‘è€…
- audï¼šå—ä¼—

è‡ªå®šä¹‰å­—æ®µï¼š
æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ·»åŠ 
```

**ğŸ”¹ ç­¾åç®—æ³•é€‰æ‹©**
```
HS256ï¼ˆå¯¹ç§°ï¼‰ï¼š
âœ… ç®€å•å¿«é€Ÿ
âœ… é€‚åˆå•ä½“åº”ç”¨
âŒ å¯†é’¥å…±äº«é—®é¢˜

RS256ï¼ˆéå¯¹ç§°ï¼‰ï¼š
âœ… å®‰å…¨æ€§æ›´é«˜
âœ… é€‚åˆå¾®æœåŠ¡
âŒ æ€§èƒ½è¾ƒæ…¢
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… å¥½çš„å®è·µ**
```javascript
// åˆç†çš„JWTè½½è·
{
  "sub": "user123",
  "exp": 1642680000,
  "role": "admin",
  "permissions": ["read", "write"]
}
```

**âŒ é¿å…çš„é—®é¢˜**
```javascript
// ä¸å¥½çš„JWTè½½è·
{
  "password": "123456",        // âŒ æ•æ„Ÿä¿¡æ¯
  "fullAddress": "è¯¦ç»†åœ°å€...", // âŒ è¿‡å¤šä¿¡æ¯
  "sessionData": {...}         // âŒ å¤§é‡æ•°æ®
}
```

**ğŸ”§ ä½¿ç”¨å»ºè®®**
- JWTå¤§å°æ§åˆ¶åœ¨**8KBä»¥å†…**
- è¿‡æœŸæ—¶é—´æ ¹æ®å®‰å…¨éœ€æ±‚è®¾å®šï¼ˆ1å°æ—¶åˆ°30å¤©ï¼‰
- ä½¿ç”¨**å¼ºå¯†é’¥**ï¼ˆè‡³å°‘32ä½éšæœºå­—ç¬¦ï¼‰
- åœ¨HTTPSç¯å¢ƒä¸­ä¼ è¾“
- å‰ç«¯ä¸è¦åœ¨JWTä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯

### 7.4 å¸¸è§é—®é¢˜è§£ç­”


**Qï¼šJWTå¯ä»¥æ’¤é”€å—ï¼Ÿ**
Aï¼šJWTæœ¬èº«æ— æ³•æ’¤é”€ï¼Œä½†å¯ä»¥é€šè¿‡é»‘åå•æœºåˆ¶å®ç°

**Qï¼šJWTè¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ**
Aï¼šéœ€è¦é‡æ–°ç™»å½•è·å–æ–°çš„JWTï¼Œæˆ–å®ç°åˆ·æ–°tokenæœºåˆ¶

**Qï¼šJWTä¸¢å¤±äº†æ€ä¹ˆåŠï¼Ÿ**
Aï¼šJWTæ— çŠ¶æ€ï¼Œä¸¢å¤±åæ— æ³•æ‰¾å›ï¼Œåªèƒ½é‡æ–°ç™»å½•

**æ ¸å¿ƒè®°å¿†**ï¼š
- JWTä¸‰éƒ¨åˆ†å„æœ‰ç”¨é€”ï¼Œç¼ºä¸€ä¸å¯
- ç¼–ç å…¬å¼€ï¼Œç­¾åä¿å®‰å…¨
- åˆç†è®¾è®¡è½½è·ï¼Œé¿å…æ•æ„Ÿä¿¡æ¯
- æ—¶é—´æ§åˆ¶å¾ˆé‡è¦ï¼Œè¿‡æœŸæœºåˆ¶è¦åšå¥½