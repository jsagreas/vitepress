---
title: 3ã€JWTç­¾åç®—æ³•è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [JWTç­¾åæœºåˆ¶æ¦‚è¿°](#1-JWTç­¾åæœºåˆ¶æ¦‚è¿°)
2. [å¯¹ç§°åŠ å¯†HS256è¯¦è§£](#2-å¯¹ç§°åŠ å¯†HS256è¯¦è§£)
3. [éå¯¹ç§°åŠ å¯†RS256è¯¦è§£](#3-éå¯¹ç§°åŠ å¯†RS256è¯¦è§£)
4. [HS256 vs RS256æ·±åº¦å¯¹æ¯”](#4-HS256-vs-RS256æ·±åº¦å¯¹æ¯”)
5. [å…¶ä»–ç­¾åç®—æ³•ä»‹ç»](#5-å…¶ä»–ç­¾åç®—æ³•ä»‹ç»)
6. [JWTæ ‡å‡†Claimsè¯¦è§£](#6-JWTæ ‡å‡†Claimsè¯¦è§£)
7. [è‡ªå®šä¹‰Claimså®æˆ˜](#7-è‡ªå®šä¹‰Claimså®æˆ˜)
8. [ç­¾åç®—æ³•é€‰æ‹©æŒ‡å—](#8-ç­¾åç®—æ³•é€‰æ‹©æŒ‡å—)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” JWTç­¾åæœºåˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯JWTç­¾å


> ğŸ’¡ **é€šä¿—ç†è§£**  
> JWTç­¾åå°±åƒæ˜¯ä¸€ä¸ª**æ•°å­—å°ç« **ï¼Œç”¨æ¥è¯æ˜è¿™ä¸ªJWTä»¤ç‰Œæ˜¯å¯ä¿¡çš„ï¼Œæ²¡æœ‰è¢«äººç¯¡æ”¹è¿‡

**ç­¾åçš„ä½œç”¨**ï¼š
```
æƒ³è±¡ä¸€ä¸ªæƒ…å†µï¼š
ä½ æ”¶åˆ°ä¸€å°é‡è¦ä¿¡ä»¶ï¼Œå¦‚ä½•ç¡®ä¿ï¼š
1. è¿™å°ä¿¡ç¡®å®æ˜¯å‘ä»¶äººå†™çš„ï¼Ÿ â†’ èº«ä»½éªŒè¯
2. ä¿¡ä»¶å†…å®¹æ²¡æœ‰è¢«åˆ«äººä¿®æ”¹ï¼Ÿ â†’ å®Œæ•´æ€§ä¿æŠ¤

JWTç­¾åå°±æ˜¯è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ï¼
```

**JWTç­¾åå·¥ä½œåŸç†**ï¼š
```
åŸå§‹æ•°æ®ï¼šHeader + Payload
åŠ å¯†å¤„ç†ï¼šä½¿ç”¨å¯†é’¥å¯¹æ•°æ®è¿›è¡Œç­¾å
æœ€ç»ˆJWTï¼šHeader.Payload.Signature

éªŒè¯æ—¶ï¼šé‡æ–°è®¡ç®—ç­¾åï¼Œä¸JWTä¸­çš„ç­¾åå¯¹æ¯”
ç»“æœï¼šç›¸åŒ = å¯ä¿¡ï¼Œä¸åŒ = è¢«ç¯¡æ”¹
```

### 1.2 JWTç»“æ„å›é¡¾


```
JWT = Header.Payload.Signature

ç¤ºä¾‹ï¼š
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0IiwibmFtZSI6IkpvaG4iLCJpYXQiOjE2MzQ1Njc4OTB9.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c

ç¬¬ä¸€éƒ¨åˆ†ï¼šHeader (ç®—æ³•ä¿¡æ¯)
ç¬¬äºŒéƒ¨åˆ†ï¼šPayload (æ•°æ®å†…å®¹)  
ç¬¬ä¸‰éƒ¨åˆ†ï¼šSignature (æ•°å­—ç­¾å)
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦ç­¾å


**ğŸš« æ²¡æœ‰ç­¾åçš„å±é™©**ï¼š
```javascript
// æ¶æ„ç”¨æˆ·å¯ä»¥éšæ„ä¿®æ”¹JWTå†…å®¹
const fakeJWT = {
  header: { "alg": "none" },
  payload: { 
    "userId": "123",
    "role": "admin",  // â† æ¶æ„æå‡æƒé™
    "exp": 9999999999
  }
}
```

**âœ… æœ‰ç­¾åçš„ä¿æŠ¤**ï¼š
```javascript
// ä»»ä½•ä¿®æ”¹éƒ½ä¼šå¯¼è‡´ç­¾åéªŒè¯å¤±è´¥
const validJWT = "header.payload.signature"
// ä¿®æ”¹ä»»ä½•å†…å®¹ â†’ ç­¾åä¸åŒ¹é… â†’ éªŒè¯å¤±è´¥ â†’ æ‹’ç»è®¿é—®
```

---

## 2. ğŸ”‘ å¯¹ç§°åŠ å¯†HS256è¯¦è§£


### 2.1 HS256åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯HS256**ï¼š
- **å…¨ç§°**ï¼šHMAC using SHA-256
- **ç±»å‹**ï¼šå¯¹ç§°åŠ å¯†ç®—æ³•
- **æ ¸å¿ƒç‰¹ç‚¹**ï¼šç­¾åå’ŒéªŒè¯ä½¿ç”¨**åŒä¸€ä¸ªå¯†é’¥**

> ğŸ’¡ **ç”Ÿæ´»æ¯”å–»**  
> HS256å°±åƒå®¶é‡Œçš„é’¥åŒ™ï¼šåŒä¸€æŠŠé’¥åŒ™æ—¢èƒ½å¼€é—¨ï¼Œä¹Ÿèƒ½é”é—¨

### 2.2 HS256å·¥ä½œåŸç†


**ç­¾åè¿‡ç¨‹**ï¼š
```
æ­¥éª¤1ï¼šå‡†å¤‡æ•°æ®
data = base64(header) + "." + base64(payload)
data = "eyJhbGci...9.eyJzdWI..."

æ­¥éª¤2ï¼šä½¿ç”¨å¯†é’¥ç­¾å
signature = HMAC-SHA256(data, secret_key)

æ­¥éª¤3ï¼šç”Ÿæˆæœ€ç»ˆJWT
jwt = data + "." + base64(signature)
```

**éªŒè¯è¿‡ç¨‹**ï¼š
```
æ­¥éª¤1ï¼šåˆ†ç¦»JWT
[header, payload, signature] = jwt.split(".")

æ­¥éª¤2ï¼šé‡æ–°è®¡ç®—ç­¾å
expected = HMAC-SHA256(header+"."+payload, secret_key)

æ­¥éª¤3ï¼šå¯¹æ¯”éªŒè¯
if (expected === signature) {
    return "éªŒè¯æˆåŠŸ"
} else {
    return "ç­¾åæ— æ•ˆ"
}
```

### 2.3 HS256ä»£ç ç¤ºä¾‹


```javascript
const crypto = require('crypto');

// 1. åˆ›å»ºJWT (HS256ç­¾å)
function createJWT_HS256(payload, secret) {
    // Header
    const header = {
        "alg": "HS256",
        "typ": "JWT"
    };
    
    // ç¼–ç Headerå’ŒPayload
    const encodedHeader = base64urlEncode(JSON.stringify(header));
    const encodedPayload = base64urlEncode(JSON.stringify(payload));
    
    // å‡†å¤‡ç­¾åæ•°æ®
    const data = encodedHeader + "." + encodedPayload;
    
    // ä½¿ç”¨HMAC-SHA256ç­¾å
    const signature = crypto
        .createHmac('sha256', secret)
        .update(data)
        .digest('base64url');
    
    // è¿”å›å®Œæ•´JWT
    return data + "." + signature;
}

// 2. éªŒè¯JWT (HS256)
function verifyJWT_HS256(jwt, secret) {
    const parts = jwt.split('.');
    if (parts.length !== 3) return false;
    
    const [header, payload, signature] = parts;
    const data = header + "." + payload;
    
    // é‡æ–°è®¡ç®—ç­¾å
    const expectedSignature = crypto
        .createHmac('sha256', secret)
        .update(data)
        .digest('base64url');
    
    // å¯¹æ¯”ç­¾å
    return signature === expectedSignature;
}

// ä½¿ç”¨ç¤ºä¾‹
const secret = "my-super-secret-key";
const payload = { userId: "123", role: "user" };

const jwt = createJWT_HS256(payload, secret);
console.log("JWT:", jwt);

const isValid = verifyJWT_HS256(jwt, secret);
console.log("éªŒè¯ç»“æœ:", isValid); // true
```

### 2.4 HS256çš„ç‰¹ç‚¹


**âœ… ä¼˜ç‚¹**ï¼š
```
ğŸš€ æ€§èƒ½é«˜ï¼šè®¡ç®—é€Ÿåº¦å¿«
ğŸ”§ å®ç°ç®€å•ï¼šåªéœ€è¦ä¸€ä¸ªå¯†é’¥
ğŸ’¾ å­˜å‚¨ç®€å•ï¼šä¸éœ€è¦ç®¡ç†å¯†é’¥å¯¹
ğŸ”„ éªŒè¯å¿«é€Ÿï¼šç­¾åå’ŒéªŒè¯éƒ½å¾ˆå¿«
```

**âŒ ç¼ºç‚¹**ï¼š
```
ğŸ”‘ å¯†é’¥ç®¡ç†ï¼šæ‰€æœ‰æœåŠ¡éƒ½éœ€è¦åŒä¸€ä¸ªå¯†é’¥
ğŸš¨ å®‰å…¨é£é™©ï¼šå¯†é’¥æ³„éœ²å½±å“æ•´ä¸ªç³»ç»Ÿ
ğŸ“± ç§»åŠ¨ç«¯é£é™©ï¼šå¯†é’¥å­˜å‚¨åœ¨å®¢æˆ·ç«¯ä¸å®‰å…¨
ğŸ”„ å¯†é’¥è½®æ¢ï¼šæ›´æ¢å¯†é’¥éœ€è¦åŒæ­¥æ‰€æœ‰æœåŠ¡
```

---

## 3. ğŸ” éå¯¹ç§°åŠ å¯†RS256è¯¦è§£


### 3.1 RS256åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯RS256**ï¼š
- **å…¨ç§°**ï¼šRSA Signature with SHA-256
- **ç±»å‹**ï¼šéå¯¹ç§°åŠ å¯†ç®—æ³•
- **æ ¸å¿ƒç‰¹ç‚¹**ï¼šä½¿ç”¨**ä¸€å¯¹å¯†é’¥**ï¼ˆå…¬é’¥+ç§é’¥ï¼‰

> ğŸ’¡ **ç”Ÿæ´»æ¯”å–»**  
> RS256å°±åƒé“¶è¡Œä¿é™©ç®±ï¼šé“¶è¡Œç”¨ç§é’¥é”ç®±å­ï¼Œä½ ç”¨å…¬é’¥éªŒè¯ç¡®å®æ˜¯é“¶è¡Œé”çš„

### 3.2 å…¬é’¥ç§é’¥æ¦‚å¿µ


**å¯†é’¥å¯¹çš„å…³ç³»**ï¼š
```
ç§é’¥ (Private Key)ï¼š
- ç”¨äºç­¾åJWT
- ç»å¯¹ä¿å¯†ï¼Œåªæœ‰æœåŠ¡å™¨æŒæœ‰
- å°±åƒä½ çš„èº«ä»½è¯ï¼Œåªæœ‰ä½ æœ‰

å…¬é’¥ (Public Key)ï¼š
- ç”¨äºéªŒè¯JWTç­¾å
- å¯ä»¥å…¬å¼€åˆ†å‘
- å°±åƒä½ çš„ç…§ç‰‡ï¼Œå¤§å®¶éƒ½èƒ½çœ‹
```

**å·¥ä½œæµç¨‹**ï¼š
```
ç­¾åæ–¹ï¼ˆæœåŠ¡å™¨ï¼‰ï¼š
1. ç”¨ç§é’¥å¯¹JWTè¿›è¡Œç­¾å
2. å°†JWTå‘é€ç»™å®¢æˆ·ç«¯

éªŒè¯æ–¹ï¼ˆä»»ä½•äººï¼‰ï¼š
1. è·å–å¯¹åº”çš„å…¬é’¥
2. ç”¨å…¬é’¥éªŒè¯JWTç­¾å
3. éªŒè¯é€šè¿‡è¯´æ˜ç¡®å®æ˜¯æœåŠ¡å™¨ç­¾å‘çš„
```

### 3.3 RS256å·¥ä½œåŸç†


**ç­¾åè¿‡ç¨‹**ï¼š
```
æ­¥éª¤1ï¼šå‡†å¤‡æ•°æ®
data = base64(header) + "." + base64(payload)

æ­¥éª¤2ï¼šä½¿ç”¨ç§é’¥ç­¾å  
signature = RSA_SIGN(SHA256(data), private_key)

æ­¥éª¤3ï¼šç”ŸæˆJWT
jwt = data + "." + base64(signature)
```

**éªŒè¯è¿‡ç¨‹**ï¼š
```
æ­¥éª¤1ï¼šåˆ†ç¦»JWTç»„ä»¶
[header, payload, signature] = jwt.split(".")

æ­¥éª¤2ï¼šä½¿ç”¨å…¬é’¥éªŒè¯
data = header + "." + payload
isValid = RSA_VERIFY(SHA256(data), signature, public_key)

æ­¥éª¤3ï¼šè¿”å›éªŒè¯ç»“æœ
```

### 3.4 RS256ä»£ç ç¤ºä¾‹


```javascript
const crypto = require('crypto');
const fs = require('fs');

// 1. ç”ŸæˆRSAå¯†é’¥å¯¹ï¼ˆå®é™…åº”ç”¨ä¸­æå‰ç”Ÿæˆï¼‰
function generateKeyPair() {
    const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
        modulusLength: 2048,
        publicKeyEncoding: {
            type: 'spki',
            format: 'pem'
        },
        privateKeyEncoding: {
            type: 'pkcs8', 
            format: 'pem'
        }
    });
    
    return { publicKey, privateKey };
}

// 2. åˆ›å»ºJWT (RS256ç­¾å)
function createJWT_RS256(payload, privateKey) {
    const header = {
        "alg": "RS256",
        "typ": "JWT"
    };
    
    const encodedHeader = base64urlEncode(JSON.stringify(header));
    const encodedPayload = base64urlEncode(JSON.stringify(payload));
    const data = encodedHeader + "." + encodedPayload;
    
    // ä½¿ç”¨RSAç§é’¥ç­¾å
    const signature = crypto
        .createSign('RSA-SHA256')
        .update(data)
        .sign(privateKey, 'base64url');
    
    return data + "." + signature;
}

// 3. éªŒè¯JWT (RS256)
function verifyJWT_RS256(jwt, publicKey) {
    const parts = jwt.split('.');
    if (parts.length !== 3) return false;
    
    const [header, payload, signature] = parts;
    const data = header + "." + payload;
    
    try {
        // ä½¿ç”¨RSAå…¬é’¥éªŒè¯
        return crypto
            .createVerify('RSA-SHA256')
            .update(data)
            .verify(publicKey, signature, 'base64url');
    } catch (error) {
        return false;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const { publicKey, privateKey } = generateKeyPair();
const payload = { userId: "123", role: "admin" };

// æœåŠ¡å™¨ç«¯ï¼šä½¿ç”¨ç§é’¥ç­¾å
const jwt = createJWT_RS256(payload, privateKey);
console.log("JWT:", jwt);

// å®¢æˆ·ç«¯ï¼šä½¿ç”¨å…¬é’¥éªŒè¯
const isValid = verifyJWT_RS256(jwt, publicKey);
console.log("éªŒè¯ç»“æœ:", isValid); // true
```

### 3.5 RS256çš„ç‰¹ç‚¹


**âœ… ä¼˜ç‚¹**ï¼š
```
ğŸ” å®‰å…¨æ€§é«˜ï¼šç§é’¥ä¸éœ€è¦åˆ†å‘
ğŸ“± å®¢æˆ·ç«¯å‹å¥½ï¼šå…¬é’¥å¯ä»¥å®‰å…¨å­˜å‚¨åœ¨å®¢æˆ·ç«¯
ğŸ¢ ä¼ä¸šçº§ï¼šé€‚åˆå¾®æœåŠ¡æ¶æ„
ğŸ”„ å¯†é’¥ç®¡ç†ï¼šå¯ä»¥ç‹¬ç«‹è½®æ¢å¯†é’¥
ğŸŒ å¯æ‰©å±•ï¼šæ”¯æŒå¤šä¸ªéªŒè¯ç«¯
```

**âŒ ç¼ºç‚¹**ï¼š
```
âš¡ æ€§èƒ½æ…¢ï¼šRSAè®¡ç®—æ¯”HMACæ…¢å¾ˆå¤š
ğŸ”§ å¤æ‚åº¦é«˜ï¼šéœ€è¦ç®¡ç†å¯†é’¥å¯¹
ğŸ’¾ å­˜å‚¨å¤æ‚ï¼šéœ€è¦å®‰å…¨å­˜å‚¨ç§é’¥
ğŸ“ ä»¤ç‰Œè¾ƒå¤§ï¼šRSAç­¾åæ¯”HMACç­¾åé•¿
```

---

## 4. âš–ï¸ HS256 vs RS256æ·±åº¦å¯¹æ¯”


### 4.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”è¡¨


| ç‰¹æ€§ | **HS256 (å¯¹ç§°)** | **RS256 (éå¯¹ç§°)** |
|------|-----------------|-------------------|
| **åŠ å¯†ç±»å‹** | `å¯¹ç§°åŠ å¯†` | `éå¯¹ç§°åŠ å¯†` |
| **å¯†é’¥æ•°é‡** | `1ä¸ªå¯†é’¥` | `1å¯¹å¯†é’¥(å…¬é’¥+ç§é’¥)` |
| **ç­¾åæ–¹** | `éœ€è¦å¯†é’¥` | `éœ€è¦ç§é’¥` |
| **éªŒè¯æ–¹** | `éœ€è¦å¯†é’¥` | `åªéœ€å…¬é’¥` |
| **æ€§èƒ½** | `âš¡ éå¸¸å¿«` | `ğŸŒ ç›¸å¯¹è¾ƒæ…¢` |
| **å®‰å…¨æ€§** | `ğŸ”’ ä¸­ç­‰` | `ğŸ” å¾ˆé«˜` |
| **å¯†é’¥åˆ†å‘** | `âŒ å›°éš¾` | `âœ… å®¹æ˜“` |
| **é€‚ç”¨åœºæ™¯** | `å•ä½“åº”ç”¨` | `åˆ†å¸ƒå¼ç³»ç»Ÿ` |

### 4.2 åº”ç”¨åœºæ™¯å¯¹æ¯”


**ğŸ  HS256é€‚ç”¨åœºæ™¯**ï¼š
```
âœ… å†…éƒ¨ç³»ç»Ÿï¼šæ‰€æœ‰ç»„ä»¶éƒ½åœ¨ä½ æ§åˆ¶èŒƒå›´å†…
âœ… å•ä½“åº”ç”¨ï¼šå‰åç«¯ç´§å¯†é›†æˆ
âœ… é«˜æ€§èƒ½è¦æ±‚ï¼šéœ€è¦å¤„ç†å¤§é‡JWTéªŒè¯
âœ… ç®€å•éƒ¨ç½²ï¼šä¸æƒ³ç®¡ç†å¤æ‚çš„å¯†é’¥åŸºç¡€è®¾æ–½

ç¤ºä¾‹åœºæ™¯ï¼š
- ä¼ä¸šå†…ç½‘ç³»ç»Ÿ
- å•ä½“Webåº”ç”¨
- é«˜å¹¶å‘APIç½‘å…³
```

**ğŸŒ RS256é€‚ç”¨åœºæ™¯**ï¼š
```
âœ… å¾®æœåŠ¡æ¶æ„ï¼šå¤šä¸ªç‹¬ç«‹çš„æœåŠ¡
âœ… ç¬¬ä¸‰æ–¹é›†æˆï¼šéœ€è¦ç»™å¤–éƒ¨ç³»ç»Ÿå…¬é’¥
âœ… ç§»åŠ¨åº”ç”¨ï¼šå®¢æˆ·ç«¯éœ€è¦éªŒè¯JWT
âœ… å¼€æ”¾å¹³å°ï¼šæä¾›APIç»™ç¬¬ä¸‰æ–¹å¼€å‘è€…

ç¤ºä¾‹åœºæ™¯ï¼š
- OAuth2æˆæƒæœåŠ¡å™¨
- å¾®æœåŠ¡APIç½‘å…³
- ç§»åŠ¨APPåç«¯
- å¼€æ”¾APIå¹³å°
```

### 4.3 å®‰å…¨æ€§åˆ†æ


**ğŸ” HS256å®‰å…¨è€ƒè™‘**ï¼š
```
é£é™©ç‚¹ï¼š
âŒ å¯†é’¥æ³„éœ² = æ•´ä¸ªç³»ç»Ÿæ²¦é™·
âŒ å®¢æˆ·ç«¯å­˜å‚¨å¯†é’¥ä¸å®‰å…¨
âŒ æœåŠ¡é—´å…±äº«å¯†é’¥æœ‰é£é™©

å®‰å…¨æªæ–½ï¼š
âœ… ä½¿ç”¨å¼ºéšæœºå¯†é’¥ (è‡³å°‘32å­—èŠ‚)
âœ… å®šæœŸè½®æ¢å¯†é’¥
âœ… ä¸¥æ ¼æ§åˆ¶å¯†é’¥è®¿é—®æƒé™
âœ… ä¸åœ¨å®¢æˆ·ç«¯éªŒè¯JWT
```

**ğŸ›¡ï¸ RS256å®‰å…¨è€ƒè™‘**ï¼š
```
ä¼˜åŠ¿ï¼š
âœ… ç§é’¥æ³„éœ²å½±å“æœ‰é™
âœ… å…¬é’¥æ³„éœ²æ— å½±å“
âœ… ä¾¿äºå¯†é’¥ç®¡ç†å’Œè½®æ¢

æ³¨æ„ç‚¹ï¼š
âš ï¸ ç§é’¥å¿…é¡»ç»å¯¹å®‰å…¨
âš ï¸ å¯†é’¥é•¿åº¦è‡³å°‘2048ä½
âš ï¸ å®šæœŸè½®æ¢å¯†é’¥å¯¹
```

### 4.4 æ€§èƒ½å¯¹æ¯”æµ‹è¯•


```javascript
// æ€§èƒ½æµ‹è¯•ç¤ºä¾‹
const crypto = require('crypto');

// æµ‹è¯•æ•°æ®å‡†å¤‡
const testData = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ";
const hmacSecret = "your-256-bit-secret";
const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
    modulusLength: 2048
});

// HS256æ€§èƒ½æµ‹è¯•
console.time('HS256 ç­¾å 1000æ¬¡');
for (let i = 0; i < 1000; i++) {
    crypto.createHmac('sha256', hmacSecret).update(testData).digest('base64');
}
console.timeEnd('HS256 ç­¾å 1000æ¬¡');

// RS256æ€§èƒ½æµ‹è¯•  
console.time('RS256 ç­¾å 1000æ¬¡');
for (let i = 0; i < 1000; i++) {
    crypto.createSign('RSA-SHA256').update(testData).sign(privateKey);
}
console.timeEnd('RS256 ç­¾å 1000æ¬¡');

/* å…¸å‹ç»“æœï¼š
HS256 ç­¾å 1000æ¬¡: 15.234ms
RS256 ç­¾å 1000æ¬¡: 147.892ms
RS256æ¯”HS256æ…¢çº¦10å€
*/
```

---

## 5. ğŸ”§ å…¶ä»–ç­¾åç®—æ³•ä»‹ç»


### 5.1 HMACç³»åˆ—ç®—æ³•


**HS384 å’Œ HS512**ï¼š
```
HS384 (HMAC using SHA-384)ï¼š
- æ›´å¼ºçš„å®‰å…¨æ€§
- æ›´é•¿çš„ç­¾å(48å­—èŠ‚)
- é€‚ä¸­çš„æ€§èƒ½

HS512 (HMAC using SHA-512)ï¼š  
- æœ€å¼ºçš„HMACå®‰å…¨æ€§
- æœ€é•¿çš„ç­¾å(64å­—èŠ‚)
- ç¨æ…¢çš„æ€§èƒ½ï¼Œä½†ä»ç„¶å¾ˆå¿«
```

**é€‰æ‹©å»ºè®®**ï¼š
```
ä¸€èˆ¬åº”ç”¨ï¼šHS256 (æ€§èƒ½ä¸å®‰å…¨å¹³è¡¡)
é«˜å®‰å…¨è¦æ±‚ï¼šHS512 (æ›´å¼ºçš„å®‰å…¨ä¿éšœ)
å¾ˆå°‘ä½¿ç”¨ï¼šHS384 (æ²¡æœ‰ç‰¹æ®Šä¼˜åŠ¿)
```

### 5.2 RSAç³»åˆ—ç®—æ³•


**RS384 å’Œ RS512**ï¼š
```
RS384 (RSA using SHA-384)ï¼š
- æ¯”RS256æ›´å®‰å…¨
- ç­¾åé•¿åº¦ç›¸åŒ
- è®¡ç®—ç¨æ…¢

RS512 (RSA using SHA-512)ï¼š
- æœ€å¼ºçš„RSAå®‰å…¨æ€§  
- ç­¾åé•¿åº¦ç›¸åŒ
- è®¡ç®—æœ€æ…¢
```

### 5.3 ECDSAç³»åˆ—ç®—æ³•


**æ¤­åœ†æ›²çº¿æ•°å­—ç­¾å**ï¼š
```
ES256 (ECDSA using P-256 and SHA-256)ï¼š
- æ¯”RSAæ›´é«˜æ•ˆ
- æ›´çŸ­çš„å¯†é’¥é•¿åº¦
- æ›´å¿«çš„ç­¾åå’ŒéªŒè¯
- ç°ä»£å¯†ç å­¦æ¨è

ES384/ES512ï¼š
- æ›´é«˜å®‰å…¨çº§åˆ«çš„ECDSAå˜ç§
```

**ECDSAä¼˜åŠ¿**ï¼š
```javascript
// ECDSAç¤ºä¾‹ (ES256)
const { publicKey, privateKey } = crypto.generateKeyPairSync('ec', {
    namedCurve: 'prime256v1'  // P-256æ›²çº¿
});

function signES256(data, privateKey) {
    return crypto.createSign('SHA256').update(data).sign(privateKey, 'base64url');
}

// ES256ç‰¹ç‚¹ï¼š
// âœ… å¯†é’¥æ›´çŸ­ (256ä½ vs RSA 2048ä½)
// âœ… ç­¾åæ›´å¿«
// âœ… éªŒè¯æ›´å¿«  
// âœ… å®‰å…¨æ€§ç›¸åŒ
```

### 5.4 ç®—æ³•é€‰æ‹©æŒ‡å—


| åœºæ™¯ | **æ¨èç®—æ³•** | **ç†ç”±** |
|------|-------------|----------|
| **å†…éƒ¨API** | `HS256` | `æ€§èƒ½æœ€ä½³ï¼Œç®¡ç†ç®€å•` |
| **å¾®æœåŠ¡** | `RS256` | `å¯†é’¥åˆ†å‘å‹å¥½` |
| **é«˜æ€§èƒ½** | `ES256` | `æ¯”RSAå¿«ï¼Œæ¯”HMACå®‰å…¨` |
| **ç§»åŠ¨åº”ç”¨** | `RS256/ES256` | `å…¬é’¥éªŒè¯å®‰å…¨` |
| **IoTè®¾å¤‡** | `HS256` | `è®¡ç®—èµ„æºæœ‰é™` |
| **é‡‘èç³»ç»Ÿ** | `ES512/RS512` | `æœ€é«˜å®‰å…¨è¦æ±‚` |

---

## 6. ğŸ“‹ JWTæ ‡å‡†Claimsè¯¦è§£


### 6.1 ä»€ä¹ˆæ˜¯Claims


> ğŸ’¡ **é€šä¿—ç†è§£**  
> Claimså°±æ˜¯JWTé‡Œé¢çš„**å£°æ˜ä¿¡æ¯**ï¼Œå‘Šè¯‰åˆ«äººè¿™ä¸ªä»¤ç‰Œä»£è¡¨ä»€ä¹ˆã€æœ‰æ•ˆæœŸå¤šé•¿ã€æ˜¯è°é¢å‘çš„ç­‰ç­‰

**Claimsçš„ä½œç”¨**ï¼š
```
å°±åƒèº«ä»½è¯ä¸Šçš„ä¿¡æ¯ï¼š
- å§“å (subject)
- ç­¾å‘æœºå…³ (issuer)  
- æœ‰æ•ˆæœŸ (expiration)
- è¯ä»¶å·ç  (jti)
- ç­¾å‘æ—¥æœŸ (issued at)
```

### 6.2 æ ‡å‡†Claimsè¯¦è§£


#### ğŸ·ï¸ iss (Issuer) - é¢å‘è€…


```javascript
{
  "iss": "https://auth.example.com"
}
```

**å«ä¹‰**ï¼šè°é¢å‘äº†è¿™ä¸ªJWT
**ç”¨é€”**ï¼šéªŒè¯JWTæ¥æºçš„å¯ä¿¡åº¦
**ç¤ºä¾‹**ï¼š
```
"iss": "https://accounts.google.com"  // Google OAuth
"iss": "https://auth.mycompany.com"   // å…¬å¸è®¤è¯æœåŠ¡
"iss": "my-app-server"                // åº”ç”¨æœåŠ¡å™¨
```

#### ğŸ‘¤ sub (Subject) - ä¸»ä½“


```javascript
{
  "sub": "user123"
}
```

**å«ä¹‰**ï¼šè¿™ä¸ªJWTæ˜¯å…³äºè°çš„
**ç”¨é€”**ï¼šæ ‡è¯†JWTä»£è¡¨çš„ç”¨æˆ·æˆ–å®ä½“
**ç¤ºä¾‹**ï¼š
```
"sub": "123456789"          // ç”¨æˆ·ID
"sub": "john@example.com"   // ç”¨æˆ·é‚®ç®±  
"sub": "service-account-1"  // æœåŠ¡è´¦æˆ·
```

#### ğŸ‘¥ aud (Audience) - å—ä¼—


```javascript
{
  "aud": ["api.example.com", "mobile-app"]
}
```

**å«ä¹‰**ï¼šè¿™ä¸ªJWTæ˜¯ç»™è°ç”¨çš„
**ç”¨é€”**ï¼šé˜²æ­¢JWTè¢«é”™è¯¯çš„æœåŠ¡ä½¿ç”¨
**ç¤ºä¾‹**ï¼š
```
"aud": "api.mysite.com"           // å•ä¸ªAPIæœåŠ¡
"aud": ["api1.com", "api2.com"]   // å¤šä¸ªæœåŠ¡
"aud": "mobile-app-v2"            // ç‰¹å®šå®¢æˆ·ç«¯
```

#### â° exp (Expiration Time) - è¿‡æœŸæ—¶é—´


```javascript
{
  "exp": 1638360000  // Unixæ—¶é—´æˆ³
}
```

**å«ä¹‰**ï¼šJWTä»€ä¹ˆæ—¶å€™è¿‡æœŸ
**ç”¨é€”**ï¼šé˜²æ­¢JWTè¢«é•¿æœŸæ»¥ç”¨
**ç¤ºä¾‹**ï¼š
```javascript
// è®¾ç½®1å°æ—¶åè¿‡æœŸ
const exp = Math.floor(Date.now() / 1000) + (60 * 60);

// è®¾ç½®7å¤©åè¿‡æœŸ  
const exp = Math.floor(Date.now() / 1000) + (7 * 24 * 60 * 60);
```

#### â³ nbf (Not Before) - ç”Ÿæ•ˆæ—¶é—´


```javascript
{
  "nbf": 1638356400  // Unixæ—¶é—´æˆ³
}
```

**å«ä¹‰**ï¼šJWTä»€ä¹ˆæ—¶å€™å¼€å§‹ç”Ÿæ•ˆ
**ç”¨é€”**ï¼šå»¶è¿Ÿç”Ÿæ•ˆï¼Œé˜²æ­¢æ—¶é—´å·®æ”»å‡»
**åœºæ™¯**ï¼š
```
é¢„ç­¾å‘çš„ä»¤ç‰Œï¼šæå‰ç­¾å‘ï¼Œå®šæ—¶ç”Ÿæ•ˆ
æ—¶åŒºå¤„ç†ï¼šè€ƒè™‘æœåŠ¡å™¨æ—¶é—´å·®å¼‚
å®‰å…¨ç¼“å†²ï¼šç»™ç³»ç»Ÿæ—¶é—´åŒæ­¥ç•™ä½™é‡
```

#### ğŸ“… iat (Issued At) - ç­¾å‘æ—¶é—´


```javascript
{
  "iat": 1638352800  // Unixæ—¶é—´æˆ³
}
```

**å«ä¹‰**ï¼šJWTä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºçš„
**ç”¨é€”**ï¼šè¿½è¸ªä»¤ç‰Œå¹´é¾„ï¼Œæ£€æµ‹é‡æ”¾æ”»å‡»
**åº”ç”¨**ï¼š
```javascript
// æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦å¤ªæ—§
const tokenAge = Math.floor(Date.now() / 1000) - jwt.iat;
if (tokenAge > maxAge) {
    throw new Error('Token too old');
}
```

#### ğŸ†” jti (JWT ID) - ä»¤ç‰ŒID


```javascript
{
  "jti": "abc123def456"
}
```

**å«ä¹‰**ï¼šJWTçš„å”¯ä¸€æ ‡è¯†ç¬¦
**ç”¨é€”**ï¼šé˜²é‡æ”¾ã€é»‘åå•ç®¡ç†ã€å®¡è®¡è¿½è¸ª
**å®ç°**ï¼š
```javascript
// ç”Ÿæˆå”¯ä¸€JTI
const jti = require('crypto').randomUUID();

// é»‘åå•æ£€æŸ¥
const blacklistedTokens = new Set();
if (blacklistedTokens.has(jwt.jti)) {
    throw new Error('Token has been revoked');
}
```

### 6.3 æ ‡å‡†Claimsä½¿ç”¨ç¤ºä¾‹


```javascript
// å®Œæ•´çš„æ ‡å‡†Claimsç¤ºä¾‹
function createCompleteJWT(userId, userEmail) {
    const now = Math.floor(Date.now() / 1000);
    
    const payload = {
        // æ ‡å‡†Claims
        iss: 'https://auth.myapp.com',        // æˆ‘ä»¬çš„è®¤è¯æœåŠ¡
        sub: userId,                          // ç”¨æˆ·ID
        aud: ['api.myapp.com', 'mobile-app'], // APIå’Œç§»åŠ¨ç«¯
        exp: now + (24 * 60 * 60),           // 24å°æ—¶åè¿‡æœŸ
        nbf: now,                            // ç«‹å³ç”Ÿæ•ˆ
        iat: now,                            // ç°åœ¨ç­¾å‘
        jti: crypto.randomUUID(),            // å”¯ä¸€ID
        
        // è‡ªå®šä¹‰Claims (ä¸‹ä¸€èŠ‚è¯¦ç»†è®²è§£)
        email: userEmail,
        role: 'user',
        permissions: ['read', 'write']
    };
    
    return signJWT(payload, privateKey);
}

// JWTéªŒè¯å‡½æ•°
function validateJWT(jwt) {
    const decoded = decodeJWT(jwt);
    const now = Math.floor(Date.now() / 1000);
    
    // æ£€æŸ¥åŸºæœ¬Claims
    if (!decoded.iss || !decoded.sub || !decoded.aud) {
        throw new Error('Missing required claims');
    }
    
    // æ£€æŸ¥æ—¶é—´Claims
    if (decoded.exp && decoded.exp < now) {
        throw new Error('Token expired');
    }
    
    if (decoded.nbf && decoded.nbf > now) {
        throw new Error('Token not yet valid');
    }
    
    // æ£€æŸ¥å—ä¼—
    if (!decoded.aud.includes('api.myapp.com')) {
        throw new Error('Invalid audience');
    }
    
    return decoded;
}
```

---

## 7. ğŸ¯ è‡ªå®šä¹‰Claimså®æˆ˜


### 7.1 ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰Claims


> ğŸ’¡ **é€šä¿—ç†è§£**  
> è‡ªå®šä¹‰Claimså°±æ˜¯åœ¨JWTé‡Œæ·»åŠ **ä½ è‡ªå·±éœ€è¦çš„ä¿¡æ¯**ï¼Œæ¯”å¦‚ç”¨æˆ·è§’è‰²ã€æƒé™ã€ä¸šåŠ¡æ•°æ®ç­‰

**è‡ªå®šä¹‰Claimsçš„å¥½å¤„**ï¼š
```
âœ… å‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼šå¸¸ç”¨ä¿¡æ¯ç›´æ¥æ”¾åœ¨JWTé‡Œ
âœ… æé«˜æ€§èƒ½ï¼šé¿å…é¢‘ç¹çš„ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢  
âœ… ç®€åŒ–é€»è¾‘ï¼šæƒé™æ£€æŸ¥æ›´ç›´æ¥
âœ… é™ä½å»¶è¿Ÿï¼šæœ¬åœ°éªŒè¯ï¼Œæ— éœ€è¿œç¨‹è°ƒç”¨
```

### 7.2 ç”¨æˆ·ä¿¡æ¯Claims


```javascript
// ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
const userClaims = {
    // æ ‡å‡†Claims
    sub: "user_123456",
    iat: 1638352800,
    exp: 1638439200,
    
    // ç”¨æˆ·ä¿¡æ¯Claims
    email: "john@example.com",
    username: "john_doe", 
    firstName: "John",
    lastName: "Doe",
    avatar: "https://cdn.example.com/avatars/john.jpg",
    verified: true,           // é‚®ç®±æ˜¯å¦éªŒè¯
    premium: false,           // æ˜¯å¦ä»˜è´¹ç”¨æˆ·
    locale: "zh-CN"          // ç”¨æˆ·è¯­è¨€åå¥½
};
```

**ä½¿ç”¨åœºæ™¯**ï¼š
```javascript
// å‰ç«¯ç›´æ¥ä»JWTè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€APIè°ƒç”¨
function getUserInfo() {
    const jwt = getJWTFromStorage();
    const decoded = decodeJWT(jwt);
    
    return {
        email: decoded.email,
        name: `${decoded.firstName} ${decoded.lastName}`,
        avatar: decoded.avatar,
        isPremium: decoded.premium
    };
}
```

### 7.3 æƒé™æ•°æ®Claims  


```javascript
// è§’è‰²å’Œæƒé™ä¿¡æ¯
const authClaims = {
    sub: "user_123456",
    
    // è§’è‰²ä¿¡æ¯
    role: "admin",                    // ä¸»è¦è§’è‰²
    roles: ["user", "admin", "editor"], // å¤šè§’è‰²æ”¯æŒ
    
    // æƒé™åˆ—è¡¨
    permissions: [
        "user:read",
        "user:write", 
        "post:create",
        "post:delete",
        "system:admin"
    ],
    
    // èµ„æºè®¿é—®æƒé™
    resources: {
        "project_123": ["read", "write"],
        "project_456": ["read"],
        "team_789": ["admin"]
    },
    
    // åŠŸèƒ½å¼€å…³
    features: {
        "beta_feature": true,
        "advanced_editor": true,
        "export_data": false
    }
};
```

**æƒé™æ£€æŸ¥å®ç°**ï¼š
```javascript
// æƒé™éªŒè¯ä¸­é—´ä»¶
function requirePermission(permission) {
    return (req, res, next) => {
        const jwt = extractJWT(req);
        const decoded = verifyJWT(jwt);
        
        // æ£€æŸ¥æƒé™
        if (!decoded.permissions || !decoded.permissions.includes(permission)) {
            return res.status(403).json({ error: 'Permission denied' });
        }
        
        req.user = decoded;
        next();
    };
}

// ä½¿ç”¨ç¤ºä¾‹
app.delete('/api/users/:id', requirePermission('user:delete'), (req, res) => {
    // åªæœ‰å…·æœ‰ 'user:delete' æƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®
    deleteUser(req.params.id);
    res.json({ success: true });
});
```

### 7.4 ä¸šåŠ¡æ•°æ®Claims


```javascript
// ä¸šåŠ¡ç‰¹å®šçš„ä¿¡æ¯
const businessClaims = {
    sub: "user_123456",
    
    // ç»„ç»‡ä¿¡æ¯
    organizationId: "org_789",
    organizationName: "ACME Corp",
    department: "Engineering",
    
    // ä¼šè¯ä¿¡æ¯  
    sessionId: "sess_abcdef123456",
    deviceId: "device_mobile_001",
    ipAddress: "192.168.1.100",
    userAgent: "Mozilla/5.0 (iPhone...)",
    
    // ä¸šåŠ¡çŠ¶æ€
    subscriptionStatus: "active",
    trialEndDate: "2024-01-31",
    quotaUsed: 75,
    quotaLimit: 100,
    
    // APIé™åˆ¶
    rateLimitTier: "premium",        // é™æµç­‰çº§
    apiCallsRemaining: 9500,         // å‰©ä½™è°ƒç”¨æ¬¡æ•°
    
    // åœ°ç†ä½ç½®
    country: "CN",
    timezone: "Asia/Shanghai"
};
```

**ä¸šåŠ¡é€»è¾‘åº”ç”¨**ï¼š
```javascript
// APIé€Ÿç‡é™åˆ¶
function rateLimitMiddleware(req, res, next) {
    const jwt = extractJWT(req);
    const decoded = verifyJWT(jwt);
    
    // æ ¹æ®ç”¨æˆ·ç­‰çº§è®¾ç½®ä¸åŒé™åˆ¶
    const limits = {
        'basic': 1000,
        'premium': 10000,
        'enterprise': 100000
    };
    
    const userLimit = limits[decoded.rateLimitTier] || limits.basic;
    
    if (decoded.apiCallsRemaining <= 0) {
        return res.status(429).json({ 
            error: 'API rate limit exceeded',
            resetTime: decoded.exp 
        });
    }
    
    next();
}
```

### 7.5 è‡ªå®šä¹‰Claimsæœ€ä½³å®è·µ


**ğŸ¯ è®¾è®¡åŸåˆ™**ï¼š

```javascript
// âœ… å¥½çš„Claimsè®¾è®¡
const goodClaims = {
    // 1. ä½¿ç”¨æ¸…æ™°çš„å‘½å
    userId: "123456",           // è€Œä¸æ˜¯ "uid" 
    userRole: "admin",          // è€Œä¸æ˜¯ "r"
    
    // 2. é¿å…æ•æ„Ÿä¿¡æ¯
    email: "john@example.com",  // âœ… é‚®ç®±å¯ä»¥
    // password: "secret123",   // âŒ å¯†ç ç»å¯¹ä¸è¡Œ
    
    // 3. æ§åˆ¶æ•°æ®å¤§å°  
    permissions: ["read", "write"], // âœ… ç²¾ç®€åˆ—è¡¨
    // fullUserProfile: {...},     // âŒ é¿å…å¤§å¯¹è±¡
    
    // 4. ä½¿ç”¨æ ‡å‡†æ ¼å¼
    exp: 1638439200,           // âœ… Unixæ—¶é—´æˆ³
    // expireTime: "2021-12-02"  // âŒ é¿å…è‡ªå®šä¹‰æ ¼å¼
};
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**ï¼š

```javascript
// ğŸ” å®‰å…¨çš„Claimsç¤ºä¾‹
const secureClaims = {
    // âœ… å¯ä»¥åŒ…å«çš„ä¿¡æ¯
    userId: "123456",
    role: "user", 
    permissions: ["read"],
    organizationId: "org123",
    
    // âŒ ç»å¯¹ä¸è¦åŒ…å«çš„ä¿¡æ¯
    // password: "plaintext",        // å¯†ç 
    // creditCard: "4111-1111-...",  // ä¿¡ç”¨å¡å·
    // ssn: "123-45-6789",          // ç¤¾ä¼šå®‰å…¨å·
    // privateKey: "-----BEGIN...", // ç§é’¥
    // sessionSecret: "abc123"      // ä¼šè¯å¯†é’¥
};
```

**ğŸ“ å¤§å°æ§åˆ¶**ï¼š

```javascript
// JWTå¤§å°ç®¡ç†
function createOptimizedJWT(user) {
    const payload = {
        sub: user.id,
        role: user.role,
        
        // åªåŒ…å«å¿…è¦çš„æƒé™ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æƒé™
        perms: user.permissions.slice(0, 10), // é™åˆ¶æƒé™æ•°é‡
        
        // ä½¿ç”¨ç®€çŸ­çš„å­—æ®µåï¼ˆä½†ä¿æŒå¯è¯»æ€§ï¼‰
        org: user.organizationId,
        tier: user.subscriptionTier,
        
        // é¿å…åµŒå¥—å¯¹è±¡ï¼Œä½¿ç”¨å¹³é“ºç»“æ„
        // features: user.features,        // âŒ å¯èƒ½å¾ˆå¤§
        betaUser: user.features.beta,      // âœ… åªå–éœ€è¦çš„
        
        exp: Math.floor(Date.now() / 1000) + 3600
    };
    
    return signJWT(payload, privateKey);
}

// JWTå¤§å°æ£€æŸ¥
function checkJWTSize(jwt) {
    const size = Buffer.byteLength(jwt, 'utf8');
    
    if (size > 8192) { // 8KBé™åˆ¶
        console.warn(`JWT size too large: ${size} bytes`);
    }
    
    return size;
}
```

---

## 8. ğŸ¯ ç­¾åç®—æ³•é€‰æ‹©æŒ‡å—


### 8.1 åœºæ™¯é©±åŠ¨çš„é€‰æ‹©


```
ğŸ  å†…éƒ¨ç³»ç»Ÿæ¶æ„ï¼š
â”œâ”€ å•ä½“åº”ç”¨ â†’ HS256 (ç®€å•é«˜æ•ˆ)
â”œâ”€ å¾®æœåŠ¡æ¶æ„ â†’ RS256 (å¯†é’¥åˆ†å‘å‹å¥½)  
â””â”€ æ··åˆæ¶æ„ â†’ ES256 (æ€§èƒ½ä¸å®‰å…¨å¹³è¡¡)

ğŸ“± å®¢æˆ·ç«¯ç±»å‹ï¼š
â”œâ”€ Webåº”ç”¨ â†’ HS256/RS256 (æœåŠ¡ç«¯éªŒè¯)
â”œâ”€ ç§»åŠ¨åº”ç”¨ â†’ RS256/ES256 (å®¢æˆ·ç«¯éªŒè¯)
â”œâ”€ æ¡Œé¢åº”ç”¨ â†’ RS256 (ç‹¬ç«‹éªŒè¯)
â””â”€ IoTè®¾å¤‡ â†’ HS256 (è®¡ç®—èµ„æºæœ‰é™)

ğŸ” å®‰å…¨ç­‰çº§ï¼š
â”œâ”€ ä¸€èˆ¬åº”ç”¨ â†’ HS256/RS256
â”œâ”€ é«˜å®‰å…¨åº”ç”¨ â†’ ES256/RS512  
â”œâ”€ é‡‘èç³»ç»Ÿ â†’ ES512/RS512
â””â”€ æ”¿åºœç³»ç»Ÿ â†’ å›½å¯†ç®—æ³•
```

### 8.2 å†³ç­–æµç¨‹å›¾


```
å¼€å§‹é€‰æ‹©JWTç­¾åç®—æ³•
         |
    éœ€è¦å®¢æˆ·ç«¯éªŒè¯JWTï¼Ÿ
    /              \
   å¦               æ˜¯
   |                |
æ˜¯å¦é«˜æ€§èƒ½è¦æ±‚ï¼Ÿ    æ˜¯å¦ä¼ä¸šçº§åº”ç”¨ï¼Ÿ
  /        \        /          \
 æ˜¯         å¦      æ˜¯           å¦  
 |          |       |           |
HS256    HS512    ES256       RS256
```

### 8.3 å®é™…é¡¹ç›®é€‰æ‹©ç¤ºä¾‹


**ğŸ“Š ç”µå•†å¹³å°**ï¼š
```javascript
// ç”¨æˆ·è®¤è¯ï¼šé«˜å¹¶å‘ï¼Œå†…éƒ¨éªŒè¯
const userJWT = {
    algorithm: 'HS256',    // é«˜æ€§èƒ½
    secret: 'user-secret-key',
    expiresIn: '2h'
};

// æ”¯ä»˜ä»¤ç‰Œï¼šé«˜å®‰å…¨ï¼Œå¤–éƒ¨éªŒè¯
const paymentJWT = {
    algorithm: 'RS256',    // å®‰å…¨åˆ†å‘
    privateKey: paymentPrivateKey,
    expiresIn: '15m'
};
```

**ğŸ¢ ä¼ä¸šSaaSå¹³å°**ï¼š
```javascript
// å¤šç§Ÿæˆ·APIè®¿é—®
const apiJWT = {
    algorithm: 'ES256',    // ç°ä»£å¯†ç å­¦
    privateKey: enterprisePrivateKey,
    claims: {
        tenantId: 'tenant_123',
        permissions: ['api:read', 'api:write']
    }
};
```

**ğŸ“± ç§»åŠ¨åº”ç”¨åç«¯**ï¼š
```javascript
// ç§»åŠ¨ç«¯éœ€è¦ç¦»çº¿éªŒè¯JWT
const mobileJWT = {
    algorithm: 'RS256',    // å…¬é’¥éªŒè¯
    publicKey: mobilePublicKey, // æ‰“åŒ…åˆ°APPä¸­
    expiresIn: '7d'
};
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ” JWTç­¾åæœ¬è´¨ï¼šæ•°å­—å°ç« ï¼Œä¿è¯JWTå®Œæ•´æ€§å’Œæ¥æºå¯ä¿¡
ğŸ”‘ å¯¹ç§°vséå¯¹ç§°ï¼šHS256ç”¨åŒä¸€å¯†é’¥ï¼ŒRS256ç”¨å¯†é’¥å¯¹  
ğŸ“‹ æ ‡å‡†Claimsï¼šissã€subã€audã€expã€nbfã€iatã€jtiä¸ƒå¤§æ ‡å‡†å­—æ®µ
ğŸ¯ è‡ªå®šä¹‰Claimsï¼šç”¨æˆ·ä¿¡æ¯ã€æƒé™æ•°æ®ã€ä¸šåŠ¡æ•°æ®çš„è½½ä½“
âš–ï¸ ç®—æ³•é€‰æ‹©ï¼šæ ¹æ®åº”ç”¨æ¶æ„ã€å®‰å…¨è¦æ±‚ã€æ€§èƒ½éœ€æ±‚é€‰æ‹©
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç­¾åç®—æ³•çš„æœ¬è´¨å·®å¼‚**ï¼š
```
HS256æ ¸å¿ƒï¼š
- ä¸€æŠŠé’¥åŒ™å¼€æ‰€æœ‰é” â†’ å¯†é’¥ç®¡ç†æŒ‘æˆ˜å¤§
- é€Ÿåº¦å¿«å¦‚é—ªç”µ â†’ é«˜å¹¶å‘åœºæ™¯é¦–é€‰
- å†…éƒ¨ä½¿ç”¨æœ€ä½³ â†’ å¤–éƒ¨åˆ†å‘æœ‰é£é™©

RS256æ ¸å¿ƒï¼š  
- ç§é’¥ç­¾åå…¬é’¥éªŒè¯ â†’ å¯†é’¥åˆ†å‘æ— é£é™©
- è®¡ç®—æ…¢ä½†å®‰å…¨ â†’ ä¼ä¸šçº§åº”ç”¨æ ‡é…
- å¾®æœåŠ¡å‹å¥½ â†’ åˆ†å¸ƒå¼æ¶æ„å¿…å¤‡
```

**ğŸ”¹ Claimsè®¾è®¡çš„å¹³è¡¡è‰ºæœ¯**ï¼š
```
ä¿¡æ¯ vs å®‰å…¨ï¼š
- å¤šæ”¾ä¿¡æ¯ = å‡å°‘æŸ¥è¯¢ + å¢åŠ é£é™©
- å°‘æ”¾ä¿¡æ¯ = å¢åŠ æŸ¥è¯¢ + é™ä½é£é™©
- é»„é‡‘æ³•åˆ™ï¼šåªæ”¾å¿…è¦ä¸”éæ•æ„Ÿçš„ä¿¡æ¯

å¤§å° vs æ€§èƒ½ï¼š
- JWTè¶Šå¤§ = ç½‘ç»œä¼ è¾“è¶Šæ…¢
- JWTè¶Šå° = åŒ…å«ä¿¡æ¯è¶Šå°‘  
- æœ€ä½³å®è·µï¼šæ§åˆ¶åœ¨8KBä»¥å†…
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ç®—æ³•é€‰æ‹©é€ŸæŸ¥è¡¨**ï¼š

| ä½ çš„æƒ…å†µ | æ¨èç®—æ³• | ç†ç”± |
|---------|---------|------|
| åˆšå¼€å§‹å­¦JWT | `HS256` | ç®€å•æ˜“æ‡‚ï¼Œå®¹æ˜“ä¸Šæ‰‹ |
| å•ä½“Webåº”ç”¨ | `HS256` | æ€§èƒ½å¥½ï¼Œç®¡ç†ç®€å• |
| å¾®æœåŠ¡æ¶æ„ | `RS256` | å¯†é’¥åˆ†å‘æ–¹ä¾¿ |
| ç§»åŠ¨APPåç«¯ | `RS256` | å®¢æˆ·ç«¯å®‰å…¨éªŒè¯ |
| é«˜æ€§èƒ½API | `HS256` | éªŒè¯é€Ÿåº¦æœ€å¿« |
| ç°ä»£ä¼ä¸šåº”ç”¨ | `ES256` | æ€§èƒ½ä¸å®‰å…¨å¹³è¡¡ |
| é‡‘èæ”¯ä»˜ç³»ç»Ÿ | `ES512/RS512` | æœ€é«˜å®‰å…¨ç­‰çº§ |

**ğŸ”§ å®è·µå»ºè®®**ï¼š
```javascript
// å¼€å‘é˜¶æ®µï¼šä½¿ç”¨HS256å¿«é€ŸåŸå‹
const devConfig = {
    algorithm: 'HS256',
    secret: 'dev-secret-key',
    expiresIn: '1d'
};

// ç”Ÿäº§ç¯å¢ƒï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©
const prodConfig = {
    algorithm: 'RS256',         // ä¼ä¸šçº§å®‰å…¨
    privateKeyFile: '/secure/private.key',
    publicKeyFile: '/public/public.key', 
    expiresIn: '2h',           // è¾ƒçŸ­æœ‰æ•ˆæœŸ
    
    // å®Œæ•´çš„Claimsè®¾è®¡
    standardClaims: ['iss', 'sub', 'aud', 'exp', 'iat'],
    customClaims: ['role', 'permissions', 'organizationId']
};
```

**âš ï¸ å¸¸è§é™·é˜±æé†’**ï¼š
```
âŒ æŠŠå¯†ç æ”¾åœ¨JWTé‡Œ â†’ å®‰å…¨é£é™©
âŒ JWTæ°¸ä¸è¿‡æœŸ â†’ æ— æ³•æ’¤é”€
âŒ å®¢æˆ·ç«¯éªŒè¯HS256 â†’ å¯†é’¥æ³„éœ²
âŒ JWTå¤ªå¤§å½±å“æ€§èƒ½ â†’ ç½‘ç»œè´Ÿæ‹…
âŒ å¿˜è®°éªŒè¯audience â†’ ä»¤ç‰Œæ»¥ç”¨
âœ… éµå¾ªæœ€å°æƒé™åŸåˆ™ â†’ åªæ”¾å¿…è¦ä¿¡æ¯
âœ… è®¾ç½®åˆç†è¿‡æœŸæ—¶é—´ â†’ 2å°æ—¶åˆ°24å°æ—¶
âœ… æ•æ„Ÿæ“ä½œé‡æ–°éªŒè¯ â†’ ä¸å®Œå…¨ä¾èµ–JWT
```

**ğŸš€ è¿›é˜¶å­¦ä¹ è·¯å¾„**ï¼š
```
ç¬¬ä¸€æ­¥ï¼šæŒæ¡HS256åŸºç¡€ä½¿ç”¨
ç¬¬äºŒæ­¥ï¼šç†è§£RS256å¯†é’¥å¯¹æ¦‚å¿µ  
ç¬¬ä¸‰æ­¥ï¼šå­¦ä¹ Claimsè®¾è®¡æœ€ä½³å®è·µ
ç¬¬å››æ­¥ï¼šäº†è§£ES256ç°ä»£ç®—æ³•
ç¬¬äº”æ­¥ï¼šJWTå®‰å…¨æ”»é˜²å’Œé˜²æŠ¤
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç­¾åç®—æ³•é€‰æ‹©æœ‰é—¨é“ï¼Œ
å¯¹ç§°éå¯¹ç§°è¦çŸ¥é“ï¼Œ
HS256å¿«é€Ÿå†…éƒ¨å¥½ï¼Œ
RS256å®‰å…¨åˆ†å‘å¦™ï¼Œ
Claimsè®¾è®¡è¦ç²¾å·§ï¼Œ
æ ‡å‡†è‡ªå®šä¹‰éƒ½é‡è¦ï¼Œ
å®‰å…¨æ€§èƒ½ä¸¤æ‰‹æŠ“ï¼Œ
JWTå®æˆ˜æœ¬é¢†é«˜ï¼
```