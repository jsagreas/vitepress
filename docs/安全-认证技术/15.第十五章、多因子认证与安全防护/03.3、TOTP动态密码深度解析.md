---
title: 3ã€TOTPåŠ¨æ€å¯†ç æ·±åº¦è§£æ
---
## ğŸ“š ç›®å½•

1. [TOTPåŠ¨æ€å¯†ç åŸºç¡€æ¦‚å¿µ](#1-TOTPåŠ¨æ€å¯†ç åŸºç¡€æ¦‚å¿µ)
2. [TOTPç®—æ³•æ ¸å¿ƒåŸç†](#2-TOTPç®—æ³•æ ¸å¿ƒåŸç†)
3. [æ—¶é—´çª—å£ä¸åŒæ­¥æœºåˆ¶](#3-æ—¶é—´çª—å£ä¸åŒæ­¥æœºåˆ¶)
4. [å…±äº«å¯†é’¥ç”Ÿæˆå’Œåˆ†å‘](#4-å…±äº«å¯†é’¥ç”Ÿæˆå’Œåˆ†å‘)
5. [Google Authenticatorå®ç°åŸç†](#5-Google-Authenticatorå®ç°åŸç†)
6. [QRç ç”Ÿæˆä¸æ‰«ææœºåˆ¶](#6-QRç ç”Ÿæˆä¸æ‰«ææœºåˆ¶)
7. [å¤šè®¾å¤‡åŒæ­¥ä¸å¯†é’¥ç®¡ç†](#7-å¤šè®¾å¤‡åŒæ­¥ä¸å¯†é’¥ç®¡ç†)
8. [å¸¸ç”¨åº“ä¸å·¥å…·å¯¹æ¯”](#8-å¸¸ç”¨åº“ä¸å·¥å…·å¯¹æ¯”)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” TOTPåŠ¨æ€å¯†ç åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯TOTP


**TOTP**ï¼ˆTime-based One-Time Passwordï¼‰æ˜¯**åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å¯†ç **ï¼Œè¿™æ˜¯å¤šå› å­è®¤è¯ä¸­æœ€å¸¸ç”¨çš„æŠ€æœ¯ä¹‹ä¸€ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒé“¶è¡Œç»™ä½ çš„åŠ¨æ€å¯†ç å™¨ï¼Œæ¯éš”30ç§’å°±ä¼šæ˜¾ç¤ºä¸€ä¸ªæ–°çš„6ä½æ•°å­—å¯†ç ï¼Œè¿™ä¸ªå¯†ç åªèƒ½ç”¨ä¸€æ¬¡ï¼Œè¿‡æœŸå°±æ— æ•ˆäº†ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- â° **æ—¶é—´ç›¸å…³**ï¼šå¯†ç æ ¹æ®å½“å‰æ—¶é—´ç”Ÿæˆ
- ğŸ”¢ **ä¸€æ¬¡æ€§**ï¼šæ¯ä¸ªå¯†ç åªèƒ½ä½¿ç”¨ä¸€æ¬¡
- ğŸ• **æœ‰æ—¶æ•ˆæ€§**ï¼šé€šå¸¸30ç§’åå¤±æ•ˆ
- ğŸ”’ **å®‰å…¨æ€§é«˜**ï¼šå³ä½¿å¯†ç æ³„éœ²ä¹Ÿå¾ˆå¿«è¿‡æœŸ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦TOTP


```
ä¼ ç»Ÿå¯†ç çš„é—®é¢˜ï¼š
ç”¨æˆ·å: admin
å¯†ç : 123456        â† ä¸€æ—¦æ³„éœ²ï¼Œè´¦æˆ·å®Œå…¨æš´éœ²

TOTPåŒé‡éªŒè¯ï¼š
ç”¨æˆ·å: admin
é™æ€å¯†ç : 123456    â† ç¬¬ä¸€å±‚ä¿æŠ¤
åŠ¨æ€å¯†ç : 485729     â† ç¬¬äºŒå±‚ä¿æŠ¤ï¼Œ30ç§’åå˜æˆå…¶ä»–æ•°å­—
```

**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- ğŸ›¡ï¸ **é˜²æ­¢å¯†ç æ³„éœ²**ï¼šå³ä½¿é™æ€å¯†ç è¢«ç›—ï¼Œè¿˜éœ€è¦åŠ¨æ€å¯†ç 
- ğŸš« **é˜²æ­¢é‡æ”¾æ”»å‡»**ï¼šåŠ¨æ€å¯†ç ç”¨è¿‡å°±å¤±æ•ˆ
- â±ï¸ **é˜²æ­¢æš´åŠ›ç ´è§£**ï¼šå¯†ç æ¯30ç§’å˜åŒ–ï¼Œç ´è§£æ—¶é—´ä¸å¤Ÿ

### 1.3 TOTPçš„å·¥ä½œæµç¨‹


```
ç”¨æˆ·ç™»å½•æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è®¾å¤‡   â”‚    â”‚   æœåŠ¡å™¨    â”‚    â”‚  è®¤è¯APP    â”‚
â”‚            â”‚    â”‚            â”‚    â”‚            â”‚
â”‚ 1.è¾“å…¥ç”¨æˆ·å â”‚â”€â”€â”€â–¶â”‚            â”‚    â”‚            â”‚
â”‚   å’Œå¯†ç     â”‚    â”‚ 2.éªŒè¯å¯†ç   â”‚    â”‚            â”‚
â”‚            â”‚    â”‚   æˆåŠŸ      â”‚    â”‚            â”‚
â”‚            â”‚    â”‚            â”‚    â”‚ 3.ç”Ÿæˆ6ä½   â”‚
â”‚ 4.è¾“å…¥åŠ¨æ€ç  â”‚â—€â”€â”€â”€â”‚ è¯·æ±‚åŠ¨æ€ç   â”‚â—€â”€â”€â”€â”‚   åŠ¨æ€ç     â”‚
â”‚   485729   â”‚â”€â”€â”€â–¶â”‚            â”‚    â”‚   485729   â”‚
â”‚            â”‚    â”‚ 5.éªŒè¯æˆåŠŸ  â”‚    â”‚            â”‚
â”‚ 6.ç™»å½•æˆåŠŸ  â”‚â—€â”€â”€â”€â”‚   æ”¾è¡Œ     â”‚    â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ§® TOTPç®—æ³•æ ¸å¿ƒåŸç†


### 2.1 TOTPç®—æ³•ç»„æˆ


**TOTP = HOTP + æ—¶é—´å› å­**

```
TOTPç®—æ³•æ ¸å¿ƒå…¬å¼ï¼š
TOTP = HOTP(K, T)

å…¶ä¸­ï¼š
K = å…±äº«å¯†é’¥ï¼ˆSecret Keyï¼‰
T = æ—¶é—´æˆ³ï¼ˆå½“å‰æ—¶é—´ Ã· 30ç§’ï¼‰
```

**ä¸‰å¤§æ ¸å¿ƒç»„ä»¶**ï¼š
- ğŸ”‘ **HMAC-SHA1**ï¼šå“ˆå¸Œæ¶ˆæ¯è®¤è¯ç ç®—æ³•
- â° **æ—¶é—´æˆ³**ï¼šå½“å‰Unixæ—¶é—´æˆ³é™¤ä»¥30
- ğŸ¯ **æˆªå–ç®—æ³•**ï¼šä»å“ˆå¸Œç»“æœä¸­æå–6ä½æ•°å­—

### 2.2 HMAC-SHA1ç®—æ³•è¯¦è§£


> ğŸ“– **HMAC-SHA1æ¦‚å¿µ**ï¼šHMACï¼ˆHash-based Message Authentication Codeï¼‰æ˜¯ä¸€ç§åŸºäºå“ˆå¸Œå‡½æ•°çš„æ¶ˆæ¯è®¤è¯ç ç®—æ³•ï¼ŒSHA1æ˜¯å…·ä½“çš„å“ˆå¸Œå‡½æ•°ã€‚

**HMAC-SHA1å·¥ä½œåŸç†**ï¼š
```
è¾“å…¥ï¼šå¯†é’¥K + æ¶ˆæ¯Mï¼ˆæ—¶é—´æˆ³ï¼‰
å¤„ç†ï¼šHMAC-SHA1(K, M)
è¾“å‡ºï¼š160ä½ï¼ˆ20å­—èŠ‚ï¼‰çš„å“ˆå¸Œå€¼
```

**ä¸ºä»€ä¹ˆé€‰æ‹©HMAC-SHA1**ï¼š
- âœ… **å¯†é’¥ç›¸å…³**ï¼šç›¸åŒæ—¶é—´æˆ³ï¼Œä¸åŒå¯†é’¥äº§ç”Ÿä¸åŒç»“æœ
- âœ… **å•å‘æ€§**ï¼šæ— æ³•ä»ç»“æœåæ¨å¯†é’¥
- âœ… **é›ªå´©æ•ˆåº”**ï¼šè¾“å…¥å¾®å°å˜åŒ–å¯¼è‡´è¾“å‡ºå·¨å¤§å˜åŒ–
- âœ… **æ ‡å‡†åŒ–**ï¼šRFC 6238æ ‡å‡†æŒ‡å®šç®—æ³•

### 2.3 æ—¶é—´æˆ³è®¡ç®—æœºåˆ¶


```javascript
// æ—¶é—´æˆ³è®¡ç®—ç¤ºä¾‹
function calculateTimeStep() {
    const currentTime = Math.floor(Date.now() / 1000); // å½“å‰Unixæ—¶é—´æˆ³
    const timeStep = Math.floor(currentTime / 30);     // é™¤ä»¥30ç§’
    return timeStep;
}

// ç¤ºä¾‹ï¼š
// å½“å‰æ—¶é—´ï¼š2025-08-12 14:30:15
// Unixæ—¶é—´æˆ³ï¼š1723456815
// æ—¶é—´æ­¥é•¿ï¼š1723456815 Ã· 30 = 57448560
```

**æ—¶é—´åŒæ­¥çš„é‡è¦æ€§**ï¼š
```
æœåŠ¡å™¨æ—¶é—´ï¼š14:30:15  â†’  æ—¶é—´æ­¥é•¿ï¼š57448560  â†’  åŠ¨æ€ç ï¼š123456
å®¢æˆ·ç«¯æ—¶é—´ï¼š14:30:16  â†’  æ—¶é—´æ­¥é•¿ï¼š57448560  â†’  åŠ¨æ€ç ï¼š123456  âœ…

æœåŠ¡å™¨æ—¶é—´ï¼š14:30:29  â†’  æ—¶é—´æ­¥é•¿ï¼š57448560  â†’  åŠ¨æ€ç ï¼š123456  
å®¢æˆ·ç«¯æ—¶é—´ï¼š14:30:31  â†’  æ—¶é—´æ­¥é•¿ï¼š57448561  â†’  åŠ¨æ€ç ï¼š789012  âŒ
```

### 2.4 åŠ¨æ€ç ç”Ÿæˆè¿‡ç¨‹


```javascript
// ç®€åŒ–çš„TOTPç”Ÿæˆç®—æ³•
function generateTOTP(secret, timeStep) {
    // 1. å°†æ—¶é—´æ­¥é•¿è½¬æ¢ä¸º8å­—èŠ‚æ•°ç»„
    const timeBuffer = Buffer.alloc(8);
    timeBuffer.writeUInt32BE(timeStep, 4);
    
    // 2. HMAC-SHA1è®¡ç®—
    const hmac = crypto.createHmac('sha1', secret);
    const hash = hmac.update(timeBuffer).digest();
    
    // 3. åŠ¨æ€æˆªå–ï¼ˆDynamic Truncationï¼‰
    const offset = hash[19] & 0x0f;              // æœ€åä¸€ä¸ªå­—èŠ‚çš„ä½4ä½
    const code = ((hash[offset] & 0x7f) << 24) | // å–4ä¸ªå­—èŠ‚
                 (hash[offset + 1] << 16) |
                 (hash[offset + 2] << 8) |
                 hash[offset + 3];
    
    // 4. å–6ä½æ•°å­—
    return (code % 1000000).toString().padStart(6, '0');
}
```

**ç®—æ³•æ­¥éª¤è§£æ**ï¼š
1. **æ—¶é—´è½¬æ¢**ï¼šå½“å‰æ—¶é—´ â†’ 30ç§’æ—¶é—´æ­¥é•¿
2. **HMACè®¡ç®—**ï¼šå¯†é’¥ + æ—¶é—´æ­¥é•¿ â†’ 20å­—èŠ‚å“ˆå¸Œ
3. **åŠ¨æ€æˆªå–**ï¼šä»20å­—èŠ‚ä¸­æˆªå–4å­—èŠ‚æ•´æ•°
4. **å–æ¨¡è¿ç®—**ï¼šæ•´æ•° % 1000000 â†’ 6ä½æ•°å­—

---

## 3. â° æ—¶é—´çª—å£ä¸åŒæ­¥æœºåˆ¶


### 3.1 30ç§’æ—¶é—´çª—å£æœºåˆ¶


> ğŸ’¡ **æ—¶é—´çª—å£æ¦‚å¿µ**ï¼šTOTPå°†æ—¶é—´åˆ’åˆ†ä¸º30ç§’çš„æ—¶é—´ç‰‡ï¼ŒåŒä¸€ä¸ªæ—¶é—´ç‰‡å†…ç”Ÿæˆçš„åŠ¨æ€ç ç›¸åŒã€‚

```
æ—¶é—´çª—å£ç¤ºä¾‹ï¼š
14:30:00 - 14:30:29  â†’  çª—å£1  â†’  åŠ¨æ€ç ï¼š123456
14:30:30 - 14:30:59  â†’  çª—å£2  â†’  åŠ¨æ€ç ï¼š789012
14:31:00 - 14:31:29  â†’  çª—å£3  â†’  åŠ¨æ€ç ï¼š456789
```

**ä¸ºä»€ä¹ˆé€‰æ‹©30ç§’**ï¼š
- âš¡ **ç”¨æˆ·ä½“éªŒ**ï¼šæ—¶é—´è¶³å¤Ÿç”¨æˆ·è¾“å…¥
- ğŸ”’ **å®‰å…¨å¹³è¡¡**ï¼šä¸ä¼šå¤ªé•¿å¯¼è‡´å®‰å…¨é£é™©
- ğŸ• **æ ‡å‡†ç»Ÿä¸€**ï¼šRFC 6238æ¨èå€¼

### 3.2 æ—¶é’Ÿåç§»å¤„ç†æœºåˆ¶


**ç°å®é—®é¢˜**ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¶é—´å¯èƒ½ä¸å®Œå…¨åŒæ­¥

```
æœåŠ¡å™¨æ—¶é—´ï¼š14:30:28  â†’  çª—å£1  â†’  åŠ¨æ€ç ï¼š123456
ç”¨æˆ·è®¾å¤‡ï¼š  14:30:32  â†’  çª—å£2  â†’  åŠ¨æ€ç ï¼š789012

ç”¨æˆ·è¾“å…¥ï¼š789012
æœåŠ¡å™¨æœŸæœ›ï¼š123456  âŒ éªŒè¯å¤±è´¥ï¼
```

**å®¹é”™æœºåˆ¶ï¼šÂ±1ä¸ªæ—¶é—´çª—å£**ï¼š
```javascript
// å®¹é”™éªŒè¯ç®—æ³•
function verifyTOTP(userCode, secret) {
    const currentTimeStep = Math.floor(Date.now() / 30000);
    
    // æ£€æŸ¥å½“å‰çª—å£å’Œå‰åå„1ä¸ªçª—å£ï¼ˆå…±3ä¸ªçª—å£ï¼‰
    const timeSteps = [
        currentTimeStep - 1,  // å‰ä¸€ä¸ªçª—å£
        currentTimeStep,      // å½“å‰çª—å£  
        currentTimeStep + 1   // åä¸€ä¸ªçª—å£
    ];
    
    for (const step of timeSteps) {
        const expectedCode = generateTOTP(secret, step);
        if (userCode === expectedCode) {
            return true;  // éªŒè¯æˆåŠŸ
        }
    }
    
    return false;  // éªŒè¯å¤±è´¥
}
```

**å®¹é”™èŒƒå›´å›¾ç¤º**ï¼š
```
æ—¶é—´è½´ï¼š    |---çª—å£1---|---çª—å£2---|---çª—å£3---|
å½“å‰æ—¶é—´ï¼š              â†‘
éªŒè¯èŒƒå›´ï¼š  [âœ… æ¥å— ] [âœ… æ¥å— ] [âœ… æ¥å— ]
           123456     789012     456123
```

### 3.3 æ—¶é—´åŒæ­¥æœ€ä½³å®è·µ


**æœåŠ¡å™¨ç«¯åŒæ­¥**ï¼š
```bash
# ä½¿ç”¨NTPåŒæ­¥æœåŠ¡å™¨æ—¶é—´
sudo ntpdate -s time.nist.gov

# è®¾ç½®å®šæ—¶åŒæ­¥
sudo crontab -e
0 */4 * * * /usr/sbin/ntpdate -s time.nist.gov
```

**å®¢æˆ·ç«¯å»ºè®®**ï¼š
- ğŸ“± **ç§»åŠ¨è®¾å¤‡**ï¼šå¼€å¯è‡ªåŠ¨æ—¶é—´åŒæ­¥
- ğŸ’» **æ¡Œé¢åº”ç”¨**ï¼šä½¿ç”¨ç³»ç»Ÿæ—¶é—´æœåŠ¡
- âš ï¸ **æ‰‹åŠ¨è°ƒæ•´**ï¼šé¿å…ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹æ—¶é—´

---

## 4. ğŸ”‘ å…±äº«å¯†é’¥ç”Ÿæˆå’Œåˆ†å‘


### 4.1 å…±äº«å¯†é’¥çš„ä½œç”¨


> ğŸ’¡ **å…±äº«å¯†é’¥æ¦‚å¿µ**ï¼šæœåŠ¡å™¨å’Œç”¨æˆ·è®¾å¤‡éƒ½ä¿å­˜çš„ç›¸åŒå¯†é’¥ï¼Œç”¨äºç”Ÿæˆç›¸åŒçš„åŠ¨æ€ç ã€‚

```
å¯†é’¥å…±äº«åŸç†ï¼š
æœåŠ¡å™¨ç«¯ï¼šå¯†é’¥ABC123 + æ—¶é—´T â†’ åŠ¨æ€ç 485729
ç”¨æˆ·è®¾å¤‡ï¼šå¯†é’¥ABC123 + æ—¶é—´T â†’ åŠ¨æ€ç 485729  âœ… ç›¸åŒï¼
```

**å¯†é’¥ç‰¹ç‚¹**ï¼š
- ğŸ” **éšæœºæ€§å¼º**ï¼šé€šå¸¸160ä½ï¼ˆ20å­—èŠ‚ï¼‰éšæœºæ•°æ®
- ğŸ¯ **Base32ç¼–ç **ï¼šæ–¹ä¾¿äººç±»é˜…è¯»å’Œè¾“å…¥
- ğŸ”’ **å”¯ä¸€æ€§**ï¼šæ¯ä¸ªç”¨æˆ·ç‹¬æœ‰çš„å¯†é’¥
- ğŸ’¾ **æŒä¹…ä¿å­˜**ï¼šä¸ä¼šæ”¹å˜ï¼Œé•¿æœŸæœ‰æ•ˆ

### 4.2 å¯†é’¥ç”Ÿæˆæœºåˆ¶


```javascript
// ç”Ÿæˆéšæœºå¯†é’¥
function generateSecret() {
    // ç”Ÿæˆ160ä½ï¼ˆ20å­—èŠ‚ï¼‰éšæœºæ•°æ®
    const randomBytes = crypto.randomBytes(20);
    
    // è½¬æ¢ä¸ºBase32ç¼–ç ï¼ˆä¾¿äºå­˜å‚¨å’Œä¼ è¾“ï¼‰
    const base32Secret = base32.encode(randomBytes);
    
    return base32Secret;  // ä¾‹å¦‚ï¼šJBSWY3DPEHPK3PXP
}
```

**Base32ç¼–ç è¯´æ˜**ï¼š
```
åŸå§‹å­—èŠ‚ï¼š  [0x48, 0x65, 0x6c, 0x6c, 0x6f]
Base32ç¼–ç ï¼šJBSWY3DP
ç‰¹ç‚¹ï¼šåªåŒ…å«A-Zå’Œ2-7ï¼Œé¿å…æ··æ·†å­—ç¬¦ï¼ˆ0,1,8,9ï¼‰
```

### 4.3 å¯†é’¥åˆ†å‘æµç¨‹


```
å¯†é’¥åˆ†å‘å®Œæ•´æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç™»å½•   â”‚    â”‚   æœåŠ¡å™¨    â”‚    â”‚ è®¤è¯APP     â”‚
â”‚            â”‚â”€â”€â”€â–¶â”‚            â”‚    â”‚            â”‚
â”‚ 1.è¯·æ±‚å¯ç”¨  â”‚    â”‚ 2.ç”Ÿæˆå¯†é’¥  â”‚    â”‚            â”‚
â”‚   2FA      â”‚    â”‚   ABC123    â”‚    â”‚            â”‚
â”‚            â”‚    â”‚            â”‚    â”‚            â”‚
â”‚ 4.æ‰«æQRç   â”‚â—€â”€â”€â”€â”‚ 3.ç”ŸæˆQRç   â”‚    â”‚            â”‚
â”‚            â”‚    â”‚   åŒ…å«å¯†é’¥  â”‚    â”‚            â”‚
â”‚            â”‚    â”‚            â”‚â”€â”€â”€â–¶â”‚ 5.ä¿å­˜å¯†é’¥  â”‚
â”‚ 6.è¾“å…¥éªŒè¯ç â”‚â”€â”€â”€â–¶â”‚            â”‚    â”‚   ABC123    â”‚
â”‚   485729   â”‚    â”‚ 7.éªŒè¯æˆåŠŸ  â”‚â—€â”€â”€â”€â”‚ ç”ŸæˆéªŒè¯ç   â”‚
â”‚            â”‚    â”‚   æ¿€æ´»2FA   â”‚    â”‚   485729   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®‰å…¨åˆ†å‘è¦ç‚¹**ï¼š
- ğŸ”’ **HTTPSä¼ è¾“**ï¼šç¡®ä¿QRç ä¼ è¾“å®‰å…¨
- ğŸ‘€ **ä¸€æ¬¡æ˜¾ç¤º**ï¼šQRç æ˜¾ç¤ºåä¸å†ä¿å­˜
- âœ… **ç«‹å³éªŒè¯**ï¼šç”Ÿæˆå¯†é’¥åç«‹å³æµ‹è¯•
- ğŸ—‘ï¸ **æ¸…ç†ç—•è¿¹**ï¼šæµè§ˆå™¨ä¸ä¿å­˜æ•æ„Ÿä¿¡æ¯

---

## 5. ğŸ“± Google Authenticatorå®ç°åŸç†


### 5.1 Google Authenticatorå·¥ä½œæœºåˆ¶


> ğŸ“– **Google Authenticatoræ¦‚å¿µ**ï¼šGoogleå¼€å‘çš„å…è´¹å¤šå› å­è®¤è¯åº”ç”¨ï¼Œå®ç°äº†æ ‡å‡†çš„TOTPç®—æ³•ã€‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ğŸ“± **ç¦»çº¿ç”Ÿæˆ**ï¼šæ— éœ€ç½‘ç»œè¿æ¥å³å¯ç”ŸæˆåŠ¨æ€ç 
- ğŸ”„ **è‡ªåŠ¨åˆ·æ–°**ï¼šæ¯30ç§’è‡ªåŠ¨æ›´æ–°åŠ¨æ€ç 
- ğŸ“Š **å¤šè´¦æˆ·ç®¡ç†**ï¼šæ”¯æŒæ·»åŠ å¤šä¸ªæœåŠ¡çš„è®¤è¯
- ğŸ”’ **æœ¬åœ°å­˜å‚¨**ï¼šå¯†é’¥å®‰å…¨å­˜å‚¨åœ¨è®¾å¤‡æœ¬åœ°

### 5.2 é›†æˆæµç¨‹è¯¦è§£


**ç¬¬ä¸€æ­¥ï¼šæœåŠ¡å™¨ç”Ÿæˆé…ç½®**
```javascript
// ç”ŸæˆTOTPé…ç½®
function generateTOTPConfig(username, serviceName) {
    const secret = generateSecret();  // ç”Ÿæˆå¯†é’¥
    
    // æ„å»ºotpauth URL
    const otpauthURL = `otpauth://totp/${encodeURIComponent(serviceName)}:${encodeURIComponent(username)}?secret=${secret}&issuer=${encodeURIComponent(serviceName)}&algorithm=SHA1&digits=6&period=30`;
    
    return {
        secret: secret,
        qrCodeURL: otpauthURL
    };
}
```

**ç¬¬äºŒæ­¥ï¼šç”ŸæˆQRç **
```javascript
// ä½¿ç”¨qrcodeåº“ç”ŸæˆQRç 
const QRCode = require('qrcode');

async function generateQRCode(otpauthURL) {
    const qrCodeDataURL = await QRCode.toDataURL(otpauthURL);
    return qrCodeDataURL;  // è¿”å›base64æ ¼å¼çš„å›¾ç‰‡
}
```

**ç¬¬ä¸‰æ­¥ï¼šç”¨æˆ·æ‰«æé…ç½®**
```
ç”¨æˆ·æ“ä½œæµç¨‹ï¼š
1. æ‰“å¼€Google Authenticator APP
2. ç‚¹å‡»"+"å·æ·»åŠ è´¦æˆ·
3. é€‰æ‹©"æ‰«æQRç "
4. æ‰«ææœåŠ¡å™¨ç”Ÿæˆçš„QRç 
5. APPè‡ªåŠ¨è§£æé…ç½®ä¿¡æ¯
6. å¼€å§‹æ˜¾ç¤º6ä½åŠ¨æ€ç 
```

### 5.3 otpauth URLæ ¼å¼è¯¦è§£


```
æ ‡å‡†otpauth URLæ ¼å¼ï¼š
otpauth://totp/æœåŠ¡å:ç”¨æˆ·å?å‚æ•°åˆ—è¡¨

ç¤ºä¾‹ï¼š
otpauth://totp/MyApp:john@example.com?secret=JBSWY3DPEHPK3PXP&issuer=MyApp&algorithm=SHA1&digits=6&period=30
```

**å‚æ•°è¯´æ˜**ï¼š
- `totp`ï¼šæŒ‡å®šä½¿ç”¨TOTPç®—æ³•
- `MyApp:john@example.com`ï¼šæ˜¾ç¤ºçš„æ ‡ç­¾
- `secret`ï¼šBase32ç¼–ç çš„å…±äº«å¯†é’¥
- `issuer`ï¼šå‘è¡Œæ–¹åç§°
- `algorithm`ï¼šå“ˆå¸Œç®—æ³•ï¼ˆé€šå¸¸SHA1ï¼‰
- `digits`ï¼šåŠ¨æ€ç ä½æ•°ï¼ˆé€šå¸¸6ä½ï¼‰
- `period`ï¼šæ—¶é—´å‘¨æœŸï¼ˆé€šå¸¸30ç§’ï¼‰

### 5.4 Google Authenticatorçš„ä¼˜åŠ¿


**æŠ€æœ¯ä¼˜åŠ¿**ï¼š
- ğŸ”’ **å®‰å…¨å¯é **ï¼šä¸¥æ ¼æŒ‰ç…§RFC 6238æ ‡å‡†å®ç°
- ğŸ“± **è·¨å¹³å°**ï¼šæ”¯æŒiOSå’ŒAndroid
- ğŸš€ **æ€§èƒ½ä¼˜ç§€**ï¼šè½»é‡çº§åº”ç”¨ï¼Œå“åº”å¿«é€Ÿ
- ğŸ”„ **æ ‡å‡†å…¼å®¹**ï¼šä¸å…¶ä»–TOTPåº”ç”¨å…¼å®¹

**ç”¨æˆ·ä½“éªŒä¼˜åŠ¿**ï¼š
- ğŸ¯ **ç®€å•æ˜“ç”¨**ï¼šç•Œé¢ç®€æ´ï¼Œæ“ä½œç›´è§‚
- ğŸ“Š **ç›´è§‚æ˜¾ç¤º**ï¼šå¤§å­—å·æ˜¾ç¤ºåŠ¨æ€ç 
- â±ï¸ **æ—¶é—´æç¤º**ï¼šæ˜¾ç¤ºå‰©ä½™æ—¶é—´
- ğŸ“± **ç¦»çº¿å·¥ä½œ**ï¼šæ— éœ€ç½‘ç»œè¿æ¥

---

## 6. ğŸ“± QRç ç”Ÿæˆä¸æ‰«ææœºåˆ¶


### 6.1 QRç åœ¨TOTPä¸­çš„ä½œç”¨


> ğŸ’¡ **QRç ä½œç”¨**ï¼šå°†å¤æ‚çš„TOTPé…ç½®ä¿¡æ¯ç¼–ç æˆäºŒç»´ç ï¼Œç”¨æˆ·æ‰«æåè‡ªåŠ¨å®Œæˆé…ç½®ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆç¹çï¼‰ï¼š
ç”¨æˆ·éœ€è¦æ‰‹åŠ¨è¾“å…¥ï¼š
- æœåŠ¡åç§°ï¼šMyApp
- è´¦æˆ·åï¼šjohn@example.com  
- å¯†é’¥ï¼šJBSWY3DPEHPK3PXP
- ç®—æ³•ï¼šSHA1
- ä½æ•°ï¼š6
- å‘¨æœŸï¼š30ç§’

QRç æ–¹å¼ï¼ˆç®€å•ï¼‰ï¼š
æ‰«ä¸€æ‰« â†’ è‡ªåŠ¨é…ç½®å®Œæˆ âœ…
```

### 6.2 QRç ç”Ÿæˆå®ç°


```javascript
// å®Œæ•´çš„QRç ç”Ÿæˆç¤ºä¾‹
const QRCode = require('qrcode');
const crypto = require('crypto');

class TOTPQRGenerator {
    // ç”ŸæˆTOTPé…ç½®
    static generateConfig(username, serviceName, issuer = null) {
        // 1. ç”Ÿæˆéšæœºå¯†é’¥
        const secret = crypto.randomBytes(20).toString('base32');
        
        // 2. æ„å»ºæ ‡ç­¾
        const label = issuer ? `${issuer}:${username}` : `${serviceName}:${username}`;
        
        // 3. æ„å»ºotpauth URL
        const params = new URLSearchParams({
            secret: secret,
            issuer: issuer || serviceName,
            algorithm: 'SHA1',
            digits: '6',
            period: '30'
        });
        
        const otpauthURL = `otpauth://totp/${encodeURIComponent(label)}?${params}`;
        
        return { secret, otpauthURL };
    }
    
    // ç”ŸæˆQRç å›¾ç‰‡
    static async generateQRCode(otpauthURL) {
        const options = {
            errorCorrectionLevel: 'M',
            type: 'image/png',
            quality: 0.92,
            margin: 1,
            color: {
                dark: '#000000',
                light: '#FFFFFF'
            }
        };
        
        return await QRCode.toDataURL(otpauthURL, options);
    }
}
```

### 6.3 QRç ä¿¡æ¯ç»“æ„


```
QRç åŒ…å«çš„å®Œæ•´ä¿¡æ¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ otpauth://totp/MyApp:john@email.com â”‚
â”‚ ?secret=JBSWY3DPEHPK3PXP            â”‚
â”‚ &issuer=MyApp                       â”‚
â”‚ &algorithm=SHA1                     â”‚
â”‚ &digits=6                           â”‚
â”‚ &period=30                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
           QRç ç¼–ç å­˜å‚¨
                  â†“
        ç”¨æˆ·APPæ‰«æè§£æ
                  â†“
        è‡ªåŠ¨é…ç½®TOTPå‚æ•°
```

### 6.4 æ‰«æåçš„å¤„ç†æµç¨‹


```
APPæ‰«æQRç åçš„å¤„ç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰«æQRç    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ è§£æURLå†…å®¹ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ æå–å‚æ•°ä¿¡æ¯ â”‚
â”‚ â€¢ secret    â”‚
â”‚ â€¢ issuer    â”‚  
â”‚ â€¢ algorithm â”‚
â”‚ â€¢ digits    â”‚
â”‚ â€¢ period    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯å‚æ•°åˆæ³•â”‚
â”‚ æ€§å¹¶ä¿å­˜é…ç½®â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ å¼€å§‹ç”ŸæˆåŠ¨æ€â”‚
â”‚ ç å¹¶æ˜¾ç¤º    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ğŸ“± å¤šè®¾å¤‡åŒæ­¥ä¸å¯†é’¥ç®¡ç†


### 7.1 å¤šè®¾å¤‡åŒæ­¥é—®é¢˜


**æ ¸å¿ƒé—®é¢˜**ï¼šç”¨æˆ·å¯èƒ½æœ‰å¤šä¸ªè®¾å¤‡éœ€è¦ä½¿ç”¨TOTP

```
ç”¨æˆ·è®¾å¤‡æƒ…å†µï¼š
ğŸ“± ä¸»æ‰‹æœºï¼šå®‰è£…Google Authenticator
ğŸ’» ç”µè„‘ï¼šéœ€è¦ç™»å½•ç½‘ç«™
ğŸ“± å¤‡ç”¨æ‰‹æœºï¼šé˜²æ­¢ä¸»æ‰‹æœºä¸¢å¤±
âŒš æ™ºèƒ½æ‰‹è¡¨ï¼šä¾¿æºå¼è®¤è¯

æŒ‘æˆ˜ï¼šå¦‚ä½•ç¡®ä¿æ‰€æœ‰è®¾å¤‡éƒ½èƒ½ç”Ÿæˆç›¸åŒçš„åŠ¨æ€ç ï¼Ÿ
```

### 7.2 åŒæ­¥æ–¹æ¡ˆå¯¹æ¯”


| åŒæ­¥æ–¹æ¡ˆ | **å·¥ä½œåŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|---------|---------|-------------|
| **ç›¸åŒå¯†é’¥** | `æ‰€æœ‰è®¾å¤‡ä½¿ç”¨åŒä¸€å¯†é’¥` | `ç®€å•å¯é ï¼Œå®Œå…¨åŒæ­¥` | `å®‰å…¨é£é™©å¤§ï¼Œä¸€ä¸ªè®¾å¤‡æ³„éœ²å…¨éƒ¨å±é™©` | `ä¸ªäººè®¾å¤‡ç®¡ç†ä¸¥æ ¼` |
| **äº‘ç«¯å¤‡ä»½** | `å¯†é’¥åŠ å¯†åå­˜å‚¨åœ¨äº‘ç«¯` | `ä¾¿äºæ¢å¤ï¼Œæ”¯æŒå¤šè®¾å¤‡` | `ä¾èµ–ç½‘ç»œï¼Œäº‘ç«¯å®‰å…¨é£é™©` | `ä¼ä¸šçº§åº”ç”¨` |
| **äºŒçº§å¯†é’¥** | `ä¸»å¯†é’¥æ´¾ç”Ÿå¤šä¸ªå­å¯†é’¥` | `å®‰å…¨æ€§è¾ƒå¥½ï¼Œç‹¬ç«‹æ€§å¼º` | `å®ç°å¤æ‚ï¼Œå…¼å®¹æ€§é—®é¢˜` | `é«˜å®‰å…¨è¦æ±‚åœºæ™¯` |
| **å¤‡ä»½ç ** | `é¢„ç”Ÿæˆå¤šä¸ªå¤‡ç”¨éªŒè¯ç ` | `ç¦»çº¿å¯ç”¨ï¼Œåº”æ€¥æ–¹æ¡ˆ` | `æœ‰é™æ¬¡æ•°ï¼Œç®¡ç†å¤æ‚` | `ç´§æ€¥å¤‡ä»½æ–¹æ¡ˆ` |

### 7.3 å¯†é’¥åˆ†å‘æœ€ä½³å®è·µ


**æ–¹æ¡ˆä¸€ï¼šç›¸åŒå¯†é’¥åˆ†å‘**
```javascript
// ä¸ºåŒä¸€ç”¨æˆ·çš„å¤šä¸ªè®¾å¤‡ç”Ÿæˆç›¸åŒé…ç½®
class MultiDeviceTOTP {
    static generateUserConfig(userId, username, serviceName) {
        // ä½¿ç”¨ç”¨æˆ·IDç¡®ä¿åŒä¸€ç”¨æˆ·çš„å¯†é’¥ä¸€è‡´
        const seed = `${userId}-${serviceName}`;
        const secret = this.deterministicSecret(seed);
        
        const config = {
            secret: secret,
            qrCodeURL: this.buildOtpauthURL(username, serviceName, secret)
        };
        
        return config;
    }
    
    // åŸºäºç§å­ç”Ÿæˆç¡®å®šæ€§å¯†é’¥
    static deterministicSecret(seed) {
        const hash = crypto.createHash('sha256').update(seed).digest();
        return hash.slice(0, 20).toString('base32');
    }
}
```

**æ–¹æ¡ˆäºŒï¼šå¤‡ä»½ç ç³»ç»Ÿ**
```javascript
// ç”Ÿæˆå¤‡ä»½éªŒè¯ç 
class BackupCodes {
    static generateBackupCodes(count = 10) {
        const codes = [];
        for (let i = 0; i < count; i++) {
            // ç”Ÿæˆ8ä½éšæœºæ•°å­—ç 
            const code = Math.random().toString().slice(2, 10);
            codes.push(code);
        }
        return codes;
    }
    
    static verifyBackupCode(inputCode, userBackupCodes) {
        const index = userBackupCodes.indexOf(inputCode);
        if (index !== -1) {
            // ä½¿ç”¨åç«‹å³ç§»é™¤ï¼ˆä¸€æ¬¡æ€§ï¼‰
            userBackupCodes.splice(index, 1);
            return true;
        }
        return false;
    }
}
```

### 7.4 è®¾å¤‡ç®¡ç†ç­–ç•¥


**è®¾å¤‡æ³¨å†Œæµç¨‹**ï¼š
```
æ–°è®¾å¤‡æ·»åŠ TOTPï¼š
1. ç”¨æˆ·åœ¨æ–°è®¾å¤‡ä¸Šè¯·æ±‚æ·»åŠ 
2. æœåŠ¡å™¨éªŒè¯ç”¨æˆ·èº«ä»½
3. æ˜¾ç¤ºç›¸åŒçš„QRç ï¼ˆç›¸åŒå¯†é’¥ï¼‰
4. ç”¨æˆ·æ‰«æé…ç½®
5. ç«‹å³éªŒè¯ç¡®ä¿é…ç½®æ­£ç¡®
6. è®°å½•è®¾å¤‡ä¿¡æ¯ç”¨äºç®¡ç†
```

**å®‰å…¨ç®¡ç†æªæ–½**ï¼š
```javascript
// è®¾å¤‡ç®¡ç†åŠŸèƒ½
class DeviceManager {
    // è®°å½•è®¾å¤‡ä¿¡æ¯
    static registerDevice(userId, deviceInfo) {
        return {
            userId: userId,
            deviceId: this.generateDeviceId(),
            deviceName: deviceInfo.name,
            deviceType: deviceInfo.type, // mobile, desktop, tablet
            registeredAt: new Date(),
            lastUsed: new Date(),
            isActive: true
        };
    }
    
    // è®¾å¤‡åˆ—è¡¨ç®¡ç†
    static listUserDevices(userId) {
        // è¿”å›ç”¨æˆ·æ‰€æœ‰å·²æ³¨å†Œçš„TOTPè®¾å¤‡
        return database.getDevicesByUser(userId);
    }
    
    // æ’¤é”€è®¾å¤‡æƒé™
    static revokeDevice(userId, deviceId) {
        // æ ‡è®°è®¾å¤‡ä¸ºä¸æ´»è·ƒï¼Œä½†ä¸å½±å“TOTPæ­£å¸¸å·¥ä½œ
        // å› ä¸ºæ‰€æœ‰è®¾å¤‡ä½¿ç”¨ç›¸åŒå¯†é’¥
        database.updateDevice(deviceId, { isActive: false });
    }
}
```

---

## 8. ğŸ› ï¸ å¸¸ç”¨åº“ä¸å·¥å…·å¯¹æ¯”


### 8.1 ä¸»æµTOTPåº”ç”¨å¯¹æ¯”


| åº”ç”¨åç§° | **å¼€å‘å•†** | **å¹³å°æ”¯æŒ** | **æ ¸å¿ƒç‰¹æ€§** | **é€‚ç”¨åœºæ™¯** |
|---------|-----------|-------------|-------------|-------------|
| **Google Authenticator** | `Google` | `iOS, Android` | `ç®€å•å¯é ï¼Œæ ‡å‡†å…¼å®¹ï¼Œæ— äº‘å¤‡ä»½` | `ä¸ªäººç”¨æˆ·ï¼Œæ ‡å‡†TOTP` |
| **Authy** | `Twilio` | `iOS, Android, Desktop, Browser` | `äº‘å¤‡ä»½ï¼Œå¤šè®¾å¤‡åŒæ­¥ï¼ŒåŠ å¯†å­˜å‚¨` | `å¤šè®¾å¤‡ç”¨æˆ·ï¼Œå¤‡ä»½éœ€æ±‚` |
| **Microsoft Authenticator** | `Microsoft` | `iOS, Android` | `æ¨é€é€šçŸ¥ï¼Œç”Ÿç‰©è¯†åˆ«ï¼Œäº‘å¤‡ä»½` | `Microsoftç”Ÿæ€ç”¨æˆ·` |
| **1Password** | `AgileBits` | `å…¨å¹³å°` | `å¯†ç ç®¡ç†é›†æˆï¼Œå®‰å…¨å­˜å‚¨` | `ä¼ä¸šç”¨æˆ·ï¼Œå¯†ç ç®¡ç†` |

### 8.2 å¼€å‘åº“é€‰æ‹©æŒ‡å—


**Node.jsç¯å¢ƒ**ï¼š
```javascript
// speakeasyåº“ - åŠŸèƒ½å…¨é¢
const speakeasy = require('speakeasy');

// ç”Ÿæˆå¯†é’¥
const secret = speakeasy.generateSecret({
    name: 'MyApp (john@example.com)',
    issuer: 'MyApp'
});

// éªŒè¯TOTP
const verified = speakeasy.totp.verify({
    secret: secret.base32,
    encoding: 'base32',
    token: userInput,
    window: 1  // å…è®¸Â±1ä¸ªæ—¶é—´çª—å£
});
```

**Pythonç¯å¢ƒ**ï¼š
```python
# pyotpåº“ - ç®€å•æ˜“ç”¨
import pyotp
import qrcode

# ç”Ÿæˆå¯†é’¥
secret = pyotp.random_base32()
totp = pyotp.TOTP(secret)

# ç”Ÿæˆå½“å‰åŠ¨æ€ç 
current_code = totp.now()

# éªŒè¯ç”¨æˆ·è¾“å…¥
is_valid = totp.verify(user_input)

# ç”ŸæˆQRç URL
qr_url = totp.provisioning_uri(
    name='john@example.com',
    issuer_name='MyApp'
)
```

**Javaç¯å¢ƒ**ï¼š
```java
// ä½¿ç”¨Apache Commons Codec
import org.apache.commons.codec.binary.Base32;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;

public class TOTPGenerator {
    private static final int TIME_STEP = 30;
    private static final int CODE_DIGITS = 6;
    
    public static String generateTOTP(String secret) {
        long timeStep = System.currentTimeMillis() / 1000 / TIME_STEP;
        return generateTOTP(secret, timeStep);
    }
    
    private static String generateTOTP(String secret, long timeStep) {
        Base32 base32 = new Base32();
        byte[] key = base32.decode(secret);
        
        // å®ç°HMAC-SHA1ç®—æ³•...
        // è¿”å›6ä½åŠ¨æ€ç 
    }
}
```

### 8.3 åº“é€‰æ‹©å»ºè®®


**é€‰æ‹©æ ‡å‡†**ï¼š
- ğŸ“š **RFCå…¼å®¹æ€§**ï¼šä¸¥æ ¼éµå¾ªRFC 6238æ ‡å‡†
- ğŸ”’ **å®‰å…¨æ€§**ï¼šæ— å·²çŸ¥å®‰å…¨æ¼æ´
- ğŸ“– **æ–‡æ¡£å®Œæ•´**ï¼šä½¿ç”¨ç¤ºä¾‹ä¸°å¯Œ
- ğŸš€ **æ´»è·ƒç»´æŠ¤**ï¼šå®šæœŸæ›´æ–°ä¿®å¤é—®é¢˜
- âš¡ **æ€§èƒ½è‰¯å¥½**ï¼šç”ŸæˆéªŒè¯é€Ÿåº¦å¿«

**æ¨èç»„åˆ**ï¼š
```
å‰ç«¯ï¼šotplib (JavaScript)
åç«¯ï¼šspeakeasy (Node.js) / pyotp (Python)
QRç ï¼šqrcode.js (å‰ç«¯) / qrcode (åç«¯)
æµ‹è¯•ï¼šGoogle Authenticator (æ ‡å‡†å‚è€ƒ)
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ TOTPæœ¬è´¨ï¼šåŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å¯†ç ï¼Œæ¯30ç§’æ›´æ–°
ğŸ”¸ ç®—æ³•æ ¸å¿ƒï¼šHMAC-SHA1 + æ—¶é—´æˆ³ = 6ä½åŠ¨æ€ç 
ğŸ”¸ æ—¶é—´åŒæ­¥ï¼š30ç§’æ—¶é—´çª—å£ï¼ŒÂ±1çª—å£å®¹é”™æœºåˆ¶
ğŸ”¸ å…±äº«å¯†é’¥ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„éšæœºå¯†é’¥
ğŸ”¸ QRç ä¼ è¾“ï¼šå°†å¤æ‚é…ç½®ä¿¡æ¯ç¼–ç ä¸ºäºŒç»´ç 
ğŸ”¸ å¤šè®¾å¤‡ç®¡ç†ï¼šç›¸åŒå¯†é’¥æˆ–å¤‡ä»½ç æ–¹æ¡ˆ
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ TOTPä¸ºä»€ä¹ˆå®‰å…¨**ï¼š
```
æ—¶æ•ˆæ€§ï¼šå¯†ç 30ç§’å¤±æ•ˆï¼Œæˆªè·ä¹Ÿå¾ˆå¿«è¿‡æœŸ
ä¸€æ¬¡æ€§ï¼šæ¯ä¸ªå¯†ç åªèƒ½ä½¿ç”¨ä¸€æ¬¡
å¯†é’¥ä¿æŠ¤ï¼šå…±äº«å¯†é’¥ä¸åœ¨ç½‘ç»œä¼ è¾“
ç¦»çº¿ç”Ÿæˆï¼šå®¢æˆ·ç«¯ç¦»çº¿ç”Ÿæˆï¼Œæ— æ³•ç›‘å¬
```

**ğŸ”¹ æ—¶é—´åŒæ­¥çš„é‡è¦æ€§**ï¼š
```
æ ¸å¿ƒé—®é¢˜ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´å¯¼è‡´åŠ¨æ€ç ä¸åŒ¹é…
è§£å†³æ–¹æ¡ˆï¼šÂ±1ä¸ªæ—¶é—´çª—å£å®¹é”™ï¼Œè¦†ç›–90ç§’æ—¶é—´èŒƒå›´
æœ€ä½³å®è·µï¼šæœåŠ¡å™¨NTPåŒæ­¥ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨æ—¶é—´æ›´æ–°
```

**ğŸ”¹ å¯†é’¥ç®¡ç†å…³é”®ç‚¹**ï¼š
```
ç”Ÿæˆï¼šä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
åˆ†å‘ï¼šé€šè¿‡QRç å®‰å…¨ä¼ è¾“ï¼Œé¿å…æ˜æ–‡æ˜¾ç¤º
å­˜å‚¨ï¼šå®¢æˆ·ç«¯æœ¬åœ°åŠ å¯†å­˜å‚¨ï¼ŒæœåŠ¡ç«¯å®‰å…¨ä¿å­˜
å¤‡ä»½ï¼šæä¾›å¤‡ä»½ç æˆ–å¤šè®¾å¤‡åŒæ­¥æ–¹æ¡ˆ
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ”§ å¼€å‘å®ç°è¦ç‚¹**ï¼š
- ä¸¥æ ¼æŒ‰ç…§RFC 6238æ ‡å‡†å®ç°ç®—æ³•
- æä¾›Â±1æ—¶é—´çª—å£çš„å®¹é”™æœºåˆ¶
- ä½¿ç”¨æ ‡å‡†çš„otpauth URLæ ¼å¼
- ç”Ÿæˆé«˜è´¨é‡çš„QRç ä¾¿äºæ‰«æ
- æä¾›å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

**ğŸ›¡ï¸ å®‰å…¨å®æ–½å»ºè®®**ï¼š
- ä½¿ç”¨HTTPSä¼ è¾“æ‰€æœ‰æ•æ„Ÿä¿¡æ¯
- å®æ–½é€Ÿç‡é™åˆ¶é˜²æ­¢æš´åŠ›ç ´è§£
- æä¾›è®¾å¤‡ç®¡ç†å’Œæ’¤é”€åŠŸèƒ½
- å®šæœŸå®¡è®¡å’Œç›‘æ§å¼‚å¸¸ä½¿ç”¨
- ç”¨æˆ·æ•™è‚²å’Œå®‰å…¨æ„è¯†åŸ¹å…»

**ğŸ‘¥ ç”¨æˆ·ä½“éªŒä¼˜åŒ–**ï¼š
- æ¸…æ™°çš„è®¾ç½®å‘å¯¼å’Œè¯´æ˜æ–‡æ¡£
- ç›´è§‚çš„QRç æ˜¾ç¤ºå’Œæ‰«æç•Œé¢
- å‹å¥½çš„é”™è¯¯æç¤ºå’Œæ•…éšœæ’é™¤
- å¤šç§è®¤è¯æ–¹å¼çš„å¤‡é€‰æ–¹æ¡ˆ
- ä¾¿æ·çš„è®¾å¤‡ç®¡ç†åŠŸèƒ½

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ æ—¶é—´ä¸åŒæ­¥é—®é¢˜**ï¼š
```
ç°è±¡ï¼šç”¨æˆ·è¾“å…¥æ­£ç¡®ä½†éªŒè¯å¤±è´¥
åŸå› ï¼šè®¾å¤‡æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´å·®å¼‚è¶…è¿‡å®¹é”™èŒƒå›´
è§£å†³ï¼šå¼•å¯¼ç”¨æˆ·æ ¡å‡†è®¾å¤‡æ—¶é—´ï¼ŒæœåŠ¡å™¨å¢åŠ å®¹é”™çª—å£
```

**â“ è®¾å¤‡ä¸¢å¤±é—®é¢˜**ï¼š
```
ç°è±¡ï¼šç”¨æˆ·æ— æ³•è·å–åŠ¨æ€ç 
åŸå› ï¼šå”¯ä¸€è®¤è¯è®¾å¤‡ä¸¢å¤±æˆ–æŸå
è§£å†³ï¼šæå‰è®¾ç½®å¤‡ä»½ç ï¼Œæ”¯æŒå¤šè®¾å¤‡é…ç½®
```

**â“ å…¼å®¹æ€§é—®é¢˜**ï¼š
```
ç°è±¡ï¼šæŸäº›APPæ— æ³•è¯†åˆ«QRç 
åŸå› ï¼šotpauth URLæ ¼å¼ä¸æ ‡å‡†
è§£å†³ï¼šä¸¥æ ¼æŒ‰ç…§RFCæ ‡å‡†æ„å»ºURLï¼Œæµ‹è¯•ä¸»æµAPPå…¼å®¹æ€§
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- TOTPåŠ¨æ€å¯†ç åŸºäºæ—¶é—´ï¼Œä¸‰åç§’ä¸€æ›´æ–°
- HMACç®—æ³•é…æ—¶é—´æˆ³ï¼Œå…­ä½æ•°å­—æœ€å®‰å…¨  
- å…±äº«å¯†é’¥æ˜¯å…³é”®ï¼ŒQRç ä¼ è¾“æœ€ä¾¿æ·
- å¤šè®¾å¤‡åŒæ­¥è¦è°¨æ…ï¼Œå¤‡ä»½æ–¹æ¡ˆä¸å¯ç¼º