---
title: 26ã€è®¤è¯ç³»ç»Ÿè®¾è®¡æ¡ˆä¾‹
---
## ğŸ“š ç›®å½•

1. [è®¤è¯ç³»ç»Ÿæ•´ä½“æ¶æ„](#1-è®¤è¯ç³»ç»Ÿæ•´ä½“æ¶æ„)
2. [ç™»å½•æ¨¡å—æ¶æ„è®¾è®¡](#2-ç™»å½•æ¨¡å—æ¶æ„è®¾è®¡)
3. [ç”¨æˆ·è§’è‰²æƒé™æ¨¡å‹è®¾è®¡](#3-ç”¨æˆ·è§’è‰²æƒé™æ¨¡å‹è®¾è®¡)
4. [Tokenç”Ÿæˆä¸éªŒè¯æœºåˆ¶](#4-tokenç”Ÿæˆä¸éªŒè¯æœºåˆ¶)
5. [æ¥å£æƒé™æ§åˆ¶è®¾è®¡](#5-æ¥å£æƒé™æ§åˆ¶è®¾è®¡)
6. [å‰åç«¯è”è°ƒæµç¨‹è¯´æ˜](#6-å‰åç«¯è”è°ƒæµç¨‹è¯´æ˜)
7. [å¤šå› å­è®¤è¯å®ç°](#7-å¤šå› å­è®¤è¯å®ç°)
8. [å®‰å…¨é˜²æŠ¤ç­–ç•¥](#8-å®‰å…¨é˜²æŠ¤ç­–ç•¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ è®¤è¯ç³»ç»Ÿæ•´ä½“æ¶æ„


### 1.1 è®¤è¯ç³»ç»Ÿæ˜¯ä»€ä¹ˆ


**ç®€å•ç†è§£**ï¼šè®¤è¯ç³»ç»Ÿå°±åƒå¤§æ¥¼çš„é—¨ç¦ç³»ç»Ÿï¼Œè´Ÿè´£ç¡®è®¤"ä½ æ˜¯è°"ï¼Œç„¶åå†³å®š"ä½ èƒ½è¿›å“ªäº›é—¨"ã€‚

```
ç°å®ä¸­çš„é—¨ç¦ç³»ç»Ÿï¼š               è®¤è¯ç³»ç»Ÿï¼š
åˆ·å¡ â†’ éªŒè¯èº«ä»½ â†’ å¼€é—¨           ç™»å½• â†’ éªŒè¯èº«ä»½ â†’ è®¿é—®èµ„æº
     â†“                              â†“
é—¨å¡é‡Œæœ‰ä½ çš„æƒé™ä¿¡æ¯           Tokené‡Œæœ‰ä½ çš„æƒé™ä¿¡æ¯
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ” **èº«ä»½è®¤è¯**ï¼šç¡®è®¤ç”¨æˆ·èº«ä»½ï¼ˆä½ æ˜¯è°ï¼Ÿï¼‰
- ğŸšª **æƒé™æˆæƒ**ï¼šå†³å®šè®¿é—®èŒƒå›´ï¼ˆä½ èƒ½åšä»€ä¹ˆï¼Ÿï¼‰
- ğŸ›¡ï¸ **å®‰å…¨é˜²æŠ¤**ï¼šä¿æŠ¤ç³»ç»Ÿèµ„æºä¸è¢«æ¶æ„è®¿é—®

### 1.2 æ•´ä½“æ¶æ„ç»„æˆ


**ç³»ç»Ÿæ¶æ„å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯åº”ç”¨      â”‚    â”‚   ç½‘å…³æœåŠ¡      â”‚    â”‚  ä¸šåŠ¡æœåŠ¡ç¾¤      â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ â€¢ ç™»å½•é¡µé¢      â”‚    â”‚ â€¢ è·¯ç”±è½¬å‘      â”‚    â”‚ â€¢ ç”¨æˆ·æœåŠ¡      â”‚
â”‚ â€¢ Tokenå­˜å‚¨     â”‚â”€â”€â”€â–¶â”‚ â€¢ æƒé™æ‹¦æˆª      â”‚â”€â”€â”€â–¶â”‚ â€¢ è®¢å•æœåŠ¡      â”‚
â”‚ â€¢ è¯·æ±‚æ‹¦æˆª      â”‚    â”‚ â€¢ è´Ÿè½½å‡è¡¡      â”‚    â”‚ â€¢ å•†å“æœåŠ¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è®¤è¯ä¸­å¿ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   è®¤è¯æœåŠ¡       â”‚
                â”‚                â”‚
                â”‚ â€¢ ç”¨æˆ·ç™»å½•      â”‚
                â”‚ â€¢ Tokenç­¾å‘     â”‚
                â”‚ â€¢ æƒé™éªŒè¯      â”‚
                â”‚ â€¢ ç”¨æˆ·ç®¡ç†      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   æ•°æ®å­˜å‚¨       â”‚
                â”‚                â”‚
                â”‚ â€¢ ç”¨æˆ·æ•°æ®      â”‚
                â”‚ â€¢ è§’è‰²æƒé™      â”‚
                â”‚ â€¢ Tokenè®°å½•     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ ¸å¿ƒç»„ä»¶è¯´æ˜


**ğŸ¯ è®¤è¯ä¸­å¿ƒ**ï¼š
- **ä½œç”¨**ï¼šä¸“é—¨è´Ÿè´£ç”¨æˆ·èº«ä»½è®¤è¯å’Œæƒé™ç®¡ç†
- **å¥½å¤„**ï¼šç»Ÿä¸€ç®¡ç†ï¼Œé¿å…æ¯ä¸ªæœåŠ¡éƒ½è¦å†™è®¤è¯é€»è¾‘

**ğŸšª ç½‘å…³æœåŠ¡**ï¼š
- **ä½œç”¨**ï¼šæ‰€æœ‰è¯·æ±‚çš„ç¬¬ä¸€é“å…³å¡
- **åŠŸèƒ½**ï¼šæ£€æŸ¥Tokenã€éªŒè¯æƒé™ã€è½¬å‘è¯·æ±‚

**ğŸ’¾ æ•°æ®å­˜å‚¨**ï¼š
- **ç”¨æˆ·æ•°æ®**ï¼šå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- **æƒé™æ•°æ®**ï¼šå­˜å‚¨ç”¨æˆ·èƒ½åšä»€ä¹ˆ
- **Tokenè®°å½•**ï¼šè¿½è¸ªç™»å½•çŠ¶æ€

---

## 2. ğŸ”‘ ç™»å½•æ¨¡å—æ¶æ„è®¾è®¡


### 2.1 ç™»å½•æµç¨‹è®¾è®¡


**æ•´ä½“ç™»å½•æµç¨‹**ï¼š
```
ç”¨æˆ·                å‰ç«¯                è®¤è¯æœåŠ¡             æ•°æ®åº“
 â”‚                   â”‚                    â”‚                   â”‚
 â”‚â”€[1]è¾“å…¥è´¦å·å¯†ç â”€â”€â–¶â”‚                    â”‚                   â”‚
 â”‚                   â”‚â”€[2]æäº¤ç™»å½•è¯·æ±‚â”€â”€â”€â–¶â”‚                   â”‚
 â”‚                   â”‚                    â”‚â”€[3]éªŒè¯ç”¨æˆ·ä¿¡æ¯â”€â”€â–¶â”‚
 â”‚                   â”‚                    â”‚â—€[4]è¿”å›ç”¨æˆ·æ•°æ®â”€â”€â”€â”‚
 â”‚                   â”‚                    â”‚                   â”‚
 â”‚                   â”‚                    â”‚â”€[5]ç”ŸæˆTokenâ”€â”€â”€â”€â”€â”‚
 â”‚                   â”‚â—€[6]è¿”å›Tokenâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
 â”‚â—€[7]ç™»å½•æˆåŠŸâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
 â”‚                   â”‚                    â”‚                   â”‚
 â”‚â”€[8]è®¿é—®ä¸šåŠ¡æ¥å£â”€â”€â–¶â”‚â”€[9]æºå¸¦Tokenâ”€â”€â”€â”€â”€â–¶â”‚                   â”‚
 â”‚                   â”‚                    â”‚â”€[10]éªŒè¯Tokenâ”€â”€â”€â”€â”‚
 â”‚                   â”‚â—€[11]è¿”å›ä¸šåŠ¡æ•°æ®â”€â”€â”€â”€â”‚                   â”‚
 â”‚â—€[12]è·å¾—æ•°æ®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
```

### 2.2 ç™»å½•æ¨¡å—æ ¸å¿ƒåŠŸèƒ½


**ğŸ”¸ è´¦å·å¯†ç ç™»å½•**ï¼š
```javascript
// å‰ç«¯ç™»å½•è¯·æ±‚
const login = async (username, password) => {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  
  const result = await response.json();
  if (result.success) {
    // å­˜å‚¨Tokenåˆ°æœ¬åœ°
    localStorage.setItem('token', result.token);
    return result;
  }
  throw new Error(result.message);
};
```

**ğŸ”¸ æ‰‹æœºéªŒè¯ç ç™»å½•**ï¼š
```javascript
// å‘é€éªŒè¯ç 
const sendSmsCode = async (phone) => {
  const response = await fetch('/api/auth/sms-code', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ phone })
  });
  return response.json();
};

// éªŒè¯ç ç™»å½•
const loginWithSms = async (phone, code) => {
  const response = await fetch('/api/auth/sms-login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ phone, code })
  });
  return response.json();
};
```

### 2.3 ç™»å½•å®‰å…¨æœºåˆ¶


**ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤æªæ–½**ï¼š

**å¯†ç åŠ å¯†å­˜å‚¨**ï¼š
```java
// åç«¯å¯†ç å¤„ç†
@Service
public class AuthService {
    
    // æ³¨å†Œæ—¶åŠ å¯†å¯†ç 
    public void register(String username, String password) {
        // ä½¿ç”¨BCryptåŠ å¯†å¯†ç 
        String hashedPassword = BCrypt.hashpw(password, BCrypt.gensalt());
        userRepository.save(new User(username, hashedPassword));
    }
    
    // ç™»å½•æ—¶éªŒè¯å¯†ç 
    public boolean validatePassword(String password, String hashedPassword) {
        return BCrypt.checkpw(password, hashedPassword);
    }
}
```

**ç™»å½•é™åˆ¶æœºåˆ¶**ï¼š
```java
// ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶
@Component
public class LoginAttemptService {
    private final Map<String, Integer> attemptsCache = new ConcurrentHashMap<>();
    
    public void recordLoginFailure(String username) {
        int attempts = attemptsCache.getOrDefault(username, 0);
        attemptsCache.put(username, attempts + 1);
    }
    
    public boolean isBlocked(String username) {
        return attemptsCache.getOrDefault(username, 0) >= 5; // 5æ¬¡å¤±è´¥åé”å®š
    }
}
```

---

## 3. ğŸ‘¥ ç”¨æˆ·è§’è‰²æƒé™æ¨¡å‹è®¾è®¡


### 3.1 RBACæƒé™æ¨¡å‹


**ä»€ä¹ˆæ˜¯RBAC**ï¼š
RBACï¼ˆRole-Based Access Controlï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œç®€å•è¯´å°±æ˜¯**ç»™ç”¨æˆ·åˆ†é…è§’è‰²ï¼Œç»™è§’è‰²åˆ†é…æƒé™**ã€‚

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
å…¬å¸ç»„ç»‡æ¶æ„ï¼š
CEO        â†’ å¯ä»¥è®¿é—®æ‰€æœ‰ç³»ç»Ÿ
éƒ¨é—¨ç»ç†    â†’ å¯ä»¥è®¿é—®æœ¬éƒ¨é—¨ç›¸å…³ç³»ç»Ÿ  
æ™®é€šå‘˜å·¥    â†’ åªèƒ½è®¿é—®åŸºç¡€åŠå…¬ç³»ç»Ÿ

RBACæ¨¡å‹ï¼š
ç”¨æˆ· â†’ åˆ†é…è§’è‰² â†’ è§’è‰²æ‹¥æœ‰æƒé™ â†’ æƒé™æ§åˆ¶èµ„æºè®¿é—®
```

### 3.2 æ•°æ®æ¨¡å‹è®¾è®¡


**ğŸ—ƒï¸ æ•°æ®åº“è¡¨ç»“æ„**ï¼š

**ç”¨æˆ·è¡¨ï¼ˆusersï¼‰**ï¼š
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,    -- ç”¨æˆ·å
    password VARCHAR(255) NOT NULL,          -- åŠ å¯†åçš„å¯†ç 
    email VARCHAR(100),                      -- é‚®ç®±
    phone VARCHAR(20),                       -- æ‰‹æœºå·
    status TINYINT DEFAULT 1,                -- çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**è§’è‰²è¡¨ï¼ˆrolesï¼‰**ï¼š
```sql
CREATE TABLE roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_name VARCHAR(50) UNIQUE NOT NULL,   -- è§’è‰²åç§°
    description VARCHAR(200),                -- è§’è‰²æè¿°
    status TINYINT DEFAULT 1,                -- çŠ¶æ€
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**æƒé™è¡¨ï¼ˆpermissionsï¼‰**ï¼š
```sql
CREATE TABLE permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    permission_name VARCHAR(100) UNIQUE NOT NULL,  -- æƒé™åç§°
    resource VARCHAR(100),                         -- èµ„æºæ ‡è¯†
    action VARCHAR(50),                           -- æ“ä½œç±»å‹ï¼šREAD/WRITE/DELETE
    description VARCHAR(200),                     -- æƒé™æè¿°
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼ˆuser_rolesï¼‰**ï¼š
```sql
CREATE TABLE user_roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,                 -- ç”¨æˆ·ID
    role_id BIGINT NOT NULL,                 -- è§’è‰²ID
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (role_id) REFERENCES roles(id),
    UNIQUE KEY unique_user_role (user_id, role_id)
);
```

**è§’è‰²æƒé™å…³è”è¡¨ï¼ˆrole_permissionsï¼‰**ï¼š
```sql
CREATE TABLE role_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_id BIGINT NOT NULL,                 -- è§’è‰²ID
    permission_id BIGINT NOT NULL,           -- æƒé™ID
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES roles(id),
    FOREIGN KEY (permission_id) REFERENCES permissions(id),
    UNIQUE KEY unique_role_permission (role_id, permission_id)
);
```

### 3.3 æƒé™æ¨¡å‹å…³ç³»å›¾


**ğŸ”— æƒé™å…³ç³»å›¾**ï¼š
```
        ç”¨æˆ·è¡¨                    è§’è‰²è¡¨                   æƒé™è¡¨
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ id: 1       â”‚          â”‚ id: 1       â”‚          â”‚ id: 1       â”‚
    â”‚ username:   â”‚          â”‚ role_name:  â”‚          â”‚ permission: â”‚
    â”‚ "zhangsan"  â”‚          â”‚ "ç®¡ç†å‘˜"     â”‚          â”‚ "user:read" â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚                         â”‚
           â”‚                         â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ id: 2       â”‚          â”‚ id: 2       â”‚          â”‚ id: 2       â”‚
    â”‚ username:   â”‚          â”‚ role_name:  â”‚          â”‚ permission: â”‚
    â”‚ "lisi"      â”‚          â”‚ "æ™®é€šç”¨æˆ·"   â”‚          â”‚ "user:write"â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚                         â”‚
           â””â”€â”€â”€â”€ ç”¨æˆ·è§’è‰²å…³è”è¡¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
                      â”‚                                        â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ è§’è‰²æƒé™å…³è”è¡¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³ç³»è¯´æ˜ï¼š
â€¢ å¼ ä¸‰ â†’ ç®¡ç†å‘˜è§’è‰² â†’ æ‹¥æœ‰ user:read å’Œ user:write æƒé™
â€¢ æå›› â†’ æ™®é€šç”¨æˆ·è§’è‰² â†’ åªæœ‰ user:read æƒé™
```

### 3.4 æƒé™æ£€æŸ¥é€»è¾‘


**ğŸ” æƒé™éªŒè¯æµç¨‹**ï¼š
```java
@Service
public class PermissionService {
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ç‰¹å®šæƒé™
    public boolean hasPermission(Long userId, String resource, String action) {
        // 1. è·å–ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²
        List<Role> userRoles = getUserRoles(userId);
        
        // 2. è·å–è¿™äº›è§’è‰²çš„æ‰€æœ‰æƒé™
        List<Permission> permissions = new ArrayList<>();
        for (Role role : userRoles) {
            permissions.addAll(getRolePermissions(role.getId()));
        }
        
        // 3. æ£€æŸ¥æ˜¯å¦åŒ…å«ç›®æ ‡æƒé™
        String targetPermission = resource + ":" + action;
        return permissions.stream()
            .anyMatch(p -> p.getPermissionName().equals(targetPermission));
    }
    
    // è·å–ç”¨æˆ·æƒé™åˆ—è¡¨ï¼ˆç”¨äºå‰ç«¯æ˜¾ç¤ºï¼‰
    public List<String> getUserPermissions(Long userId) {
        List<Role> roles = getUserRoles(userId);
        List<String> permissions = new ArrayList<>();
        
        for (Role role : roles) {
            List<Permission> rolePerms = getRolePermissions(role.getId());
            rolePerms.forEach(p -> permissions.add(p.getPermissionName()));
        }
        
        return permissions;
    }
}
```

---

## 4. ğŸ« Tokenç”Ÿæˆä¸éªŒè¯æœºåˆ¶


### 4.1 ä»€ä¹ˆæ˜¯Token


**ç®€å•ç†è§£**ï¼šTokenå°±åƒæ˜¯ä¸€å¼ **ä¸´æ—¶é€šè¡Œè¯**ï¼Œè¯æ˜ä½ å·²ç»ç™»å½•è¿‡äº†ï¼Œå¯ä»¥è®¿é—®ç³»ç»Ÿèµ„æºã€‚

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
æ¸¸ä¹å›­é—¨ç¥¨ï¼š                      Tokenï¼š
ä¹°ç¥¨ â†’ è·å¾—æ‰‹ç¯ â†’ å‡­æ‰‹ç¯ç©é¡¹ç›®      ç™»å½• â†’ è·å¾—Token â†’ å‡­Tokenè®¿é—®æ¥å£
æ‰‹ç¯ä¸Šæœ‰æœ‰æ•ˆæœŸå’Œå¯ç©é¡¹ç›®ä¿¡æ¯        Tokené‡Œæœ‰æœ‰æ•ˆæœŸå’Œæƒé™ä¿¡æ¯
```

### 4.2 JWT Tokenè¯¦è§£


**JWTæ˜¯ä»€ä¹ˆ**ï¼š
JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç§**è‡ªåŒ…å«**çš„Tokenæ ¼å¼ï¼Œé‡Œé¢åŒ…å«äº†ç”¨æˆ·ä¿¡æ¯å’Œæƒé™ä¿¡æ¯ã€‚

**JWTç»“æ„**ï¼š
```
JWT = Header.Payload.Signature

ä¾‹å¦‚ï¼š
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c

åˆ†è§£ï¼š
Header:    eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
Payload:   eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ
Signature: SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

### 4.3 Tokenç”Ÿæˆå®ç°


**ğŸ”§ JWTç”Ÿæˆä»£ç **ï¼š
```java
@Service
public class JwtTokenService {
    
    private final String SECRET_KEY = "mySecretKey"; // å¯†é’¥ï¼Œå®é™…é¡¹ç›®è¦ç”¨é…ç½®æ–‡ä»¶
    private final long EXPIRATION = 7 * 24 * 60 * 60 * 1000; // 7å¤©æœ‰æ•ˆæœŸ
    
    // ç”ŸæˆToken
    public String generateToken(User user) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("userId", user.getId());
        claims.put("username", user.getUsername());
        claims.put("roles", getUserRoles(user.getId())); // ç”¨æˆ·è§’è‰²
        claims.put("permissions", getUserPermissions(user.getId())); // ç”¨æˆ·æƒé™
        
        return createToken(claims);
    }
    
    private String createToken(Map<String, Object> claims) {
        return Jwts.builder()
            .setClaims(claims)                          // è®¾ç½®è½½è·
            .setSubject(claims.get("username").toString()) // è®¾ç½®ä¸»é¢˜
            .setIssuedAt(new Date())                   // ç­¾å‘æ—¶é—´
            .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION)) // è¿‡æœŸæ—¶é—´
            .signWith(SignatureAlgorithm.HS512, SECRET_KEY) // ç­¾åç®—æ³•å’Œå¯†é’¥
            .compact();
    }
}
```

### 4.4 TokenéªŒè¯å®ç°


**ğŸ” TokenéªŒè¯ä»£ç **ï¼š
```java
@Service
public class JwtTokenService {
    
    // éªŒè¯Tokenæ˜¯å¦æœ‰æ•ˆ
    public boolean validateToken(String token) {
        try {
            Jwts.parser().setSigningKey(SECRET_KEY).parseClaimsJws(token);
            return true;
        } catch (JwtException | IllegalArgumentException e) {
            return false; // Tokenæ— æ•ˆ
        }
    }
    
    // ä»Tokenä¸­æå–ç”¨æˆ·ä¿¡æ¯
    public Claims getClaimsFromToken(String token) {
        return Jwts.parser()
            .setSigningKey(SECRET_KEY)
            .parseClaimsJws(token)
            .getBody();
    }
    
    // ä»Tokenä¸­è·å–ç”¨æˆ·ID
    public Long getUserIdFromToken(String token) {
        Claims claims = getClaimsFromToken(token);
        return claims.get("userId", Long.class);
    }
    
    // æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ
    public boolean isTokenExpired(String token) {
        Claims claims = getClaimsFromToken(token);
        return claims.getExpiration().before(new Date());
    }
}
```

### 4.5 Tokenå­˜å‚¨ç­–ç•¥


**ğŸ’¾ å‰ç«¯Tokenå­˜å‚¨å¯¹æ¯”**ï¼š

| å­˜å‚¨æ–¹å¼ | å®‰å…¨æ€§ | ä¾¿åˆ©æ€§ | é€‚ç”¨åœºæ™¯ | æ³¨æ„äº‹é¡¹ |
|---------|--------|--------|----------|----------|
| **localStorage** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ é«˜ | é•¿æœŸç™»å½• | å®¹æ˜“è¢«XSSæ”»å‡» |
| **sessionStorage** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ  ä¸­ç­‰ | çŸ­æœŸä¼šè¯ | å…³é—­é¡µé¢å°±å¤±æ•ˆ |
| **Cookie** | ğŸŸ¢ é«˜ | ğŸŸ  ä¸­ç­‰ | ä¼ä¸šçº§åº”ç”¨ | éœ€è¦é˜²CSRFæ”»å‡» |
| **å†…å­˜** | ğŸŸ¢ é«˜ | ğŸ”´ ä½ | é«˜å®‰å…¨è¦æ±‚ | åˆ·æ–°é¡µé¢å°±ä¸¢å¤± |

**æ¨èæ–¹æ¡ˆ**ï¼š
```javascript
// Tokenç®¡ç†å·¥å…·ç±»
class TokenManager {
    static setToken(token) {
        // æ•æ„Ÿç³»ç»Ÿç”¨sessionStorageï¼Œä¸€èˆ¬ç³»ç»Ÿç”¨localStorage
        const storage = this.isSensitiveSystem() ? sessionStorage : localStorage;
        storage.setItem('auth_token', token);
    }
    
    static getToken() {
        return localStorage.getItem('auth_token') || sessionStorage.getItem('auth_token');
    }
    
    static removeToken() {
        localStorage.removeItem('auth_token');
        sessionStorage.removeItem('auth_token');
    }
    
    static isSensitiveSystem() {
        // æ ¹æ®ç³»ç»Ÿç±»å‹åˆ¤æ–­ï¼Œæ¯”å¦‚é‡‘èç³»ç»Ÿè¿”å›true
        return window.location.host.includes('finance');
    }
}
```

---

## 5. ğŸ”’ æ¥å£æƒé™æ§åˆ¶è®¾è®¡


### 5.1 æƒé™æ§åˆ¶åŸç†


**æƒé™æ§åˆ¶å°±åƒé—¨å«æ£€æŸ¥**ï¼š
```
è®¿é—®æ¥å£æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ æºå¸¦Token â†’ ç½‘å…³éªŒè¯ â†’ æ£€æŸ¥æƒé™ â†’ å…è®¸/æ‹’ç»è®¿é—®

å°±åƒè¿›å°åŒºï¼š
æƒ³è¿›å°åŒº â†’ å‡ºç¤ºé—¨å¡ â†’ é—¨å«éªŒè¯ â†’ æ£€æŸ¥æƒé™ â†’ å¼€é—¨/æ‹’ç»
```

### 5.2 ç½‘å…³å±‚æƒé™æ‹¦æˆª


**ğŸšª ç½‘å…³ç»Ÿä¸€æƒé™æ§åˆ¶**ï¼š
```java
@Component
public class AuthenticationFilter implements GlobalFilter, Ordered {
    
    @Autowired
    private JwtTokenService jwtTokenService;
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String path = exchange.getRequest().getURI().getPath();
        
        // ç™½åå•æ¥å£ç›´æ¥æ”¾è¡Œ
        if (isWhiteList(path)) {
            return chain.filter(exchange);
        }
        
        // è·å–Token
        String token = getTokenFromRequest(exchange.getRequest());
        if (token == null) {
            return unauthorizedResponse(exchange, "ç¼ºå°‘è®¤è¯Token");
        }
        
        // éªŒè¯Token
        if (!jwtTokenService.validateToken(token)) {
            return unauthorizedResponse(exchange, "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ");
        }
        
        // æƒé™æ£€æŸ¥
        if (!hasPermission(token, path)) {
            return forbiddenResponse(exchange, "æƒé™ä¸è¶³");
        }
        
        // åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯ï¼Œä¼ é€’ç»™åç«¯æœåŠ¡
        ServerHttpRequest modifiedRequest = exchange.getRequest().mutate()
            .header("X-User-Id", jwtTokenService.getUserIdFromToken(token).toString())
            .header("X-Username", jwtTokenService.getUsernameFromToken(token))
            .build();
        
        return chain.filter(exchange.mutate().request(modifiedRequest).build());
    }
    
    private boolean isWhiteList(String path) {
        String[] whiteList = {"/api/auth/login", "/api/auth/register", "/api/public/**"};
        return Arrays.stream(whiteList).anyMatch(pattern -> pathMatches(path, pattern));
    }
}
```

### 5.3 æ³¨è§£å¼æƒé™æ§åˆ¶


**ğŸ·ï¸ åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶**ï¼š
```java
// æƒé™æ£€æŸ¥æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequirePermission {
    String value(); // éœ€è¦çš„æƒé™æ ‡è¯†
}

// è§’è‰²æ£€æŸ¥æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequireRole {
    String[] value(); // éœ€è¦çš„è§’è‰²
}

// ä½¿ç”¨ç¤ºä¾‹
@RestController
@RequestMapping("/api/user")
public class UserController {
    
    @GetMapping("/list")
    @RequirePermission("user:read")  // éœ€è¦ç”¨æˆ·è¯»æƒé™
    public ResponseEntity<List<User>> getUserList() {
        // è·å–ç”¨æˆ·åˆ—è¡¨
        return ResponseEntity.ok(userService.getAllUsers());
    }
    
    @PostMapping("/create")
    @RequirePermission("user:write")  // éœ€è¦ç”¨æˆ·å†™æƒé™
    public ResponseEntity<User> createUser(@RequestBody User user) {
        // åˆ›å»ºç”¨æˆ·
        return ResponseEntity.ok(userService.createUser(user));
    }
    
    @DeleteMapping("/{id}")
    @RequireRole({"ADMIN", "SUPER_ADMIN"})  // éœ€è¦ç®¡ç†å‘˜è§’è‰²
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        // åˆ é™¤ç”¨æˆ·
        userService.deleteUser(id);
        return ResponseEntity.ok().build();
    }
}
```

### 5.4 AOPæƒé™æ‹¦æˆªå™¨


**ğŸ”„ AOPå®ç°æƒé™æ£€æŸ¥**ï¼š
```java
@Aspect
@Component
public class PermissionAspect {
    
    @Autowired
    private PermissionService permissionService;
    
    @Around("@annotation(requirePermission)")
    public Object checkPermission(ProceedingJoinPoint joinPoint, RequirePermission requirePermission) throws Throwable {
        // è·å–å½“å‰ç”¨æˆ·IDï¼ˆä»è¯·æ±‚å¤´æˆ–ThreadLocalä¸­è·å–ï¼‰
        Long userId = getCurrentUserId();
        
        // æ£€æŸ¥æƒé™
        String permission = requirePermission.value();
        if (!permissionService.hasPermission(userId, permission)) {
            throw new AccessDeniedException("æƒé™ä¸è¶³ï¼Œéœ€è¦æƒé™ï¼š" + permission);
        }
        
        // æƒé™æ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡ŒåŸæ–¹æ³•
        return joinPoint.proceed();
    }
    
    @Around("@annotation(requireRole)")
    public Object checkRole(ProceedingJoinPoint joinPoint, RequireRole requireRole) throws Throwable {
        Long userId = getCurrentUserId();
        String[] requiredRoles = requireRole.value();
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰ä»»æ„ä¸€ä¸ªæ‰€éœ€è§’è‰²
        boolean hasRole = Arrays.stream(requiredRoles)
            .anyMatch(role -> permissionService.hasRole(userId, role));
            
        if (!hasRole) {
            throw new AccessDeniedException("æƒé™ä¸è¶³ï¼Œéœ€è¦è§’è‰²ï¼š" + String.join("æˆ–", requiredRoles));
        }
        
        return joinPoint.proceed();
    }
    
    private Long getCurrentUserId() {
        // ä»è¯·æ±‚å¤´æˆ–SecurityContextä¸­è·å–å½“å‰ç”¨æˆ·ID
        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        String userIdHeader = request.getHeader("X-User-Id");
        return userIdHeader != null ? Long.parseLong(userIdHeader) : null;
    }
}
```

### 5.5 å‰ç«¯æƒé™æ§åˆ¶


**ğŸ–¥ï¸ å‰ç«¯æƒé™ç®¡ç†**ï¼š
```javascript
// æƒé™ç®¡ç†å·¥å…·ç±»
class PermissionManager {
    constructor() {
        this.userPermissions = [];
        this.userRoles = [];
    }
    
    // åˆå§‹åŒ–ç”¨æˆ·æƒé™ä¿¡æ¯
    async initUserPermissions() {
        try {
            const response = await fetch('/api/auth/user-info', {
                headers: { 'Authorization': `Bearer ${TokenManager.getToken()}` }
            });
            const userInfo = await response.json();
            
            this.userPermissions = userInfo.permissions || [];
            this.userRoles = userInfo.roles || [];
        } catch (error) {
            console.error('è·å–ç”¨æˆ·æƒé™å¤±è´¥:', error);
        }
    }
    
    // æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹å®šæƒé™
    hasPermission(permission) {
        return this.userPermissions.includes(permission);
    }
    
    // æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹å®šè§’è‰²
    hasRole(role) {
        return this.userRoles.includes(role);
    }
    
    // æ£€æŸ¥æ˜¯å¦æœ‰ä»»æ„ä¸€ä¸ªæƒé™
    hasAnyPermission(permissions) {
        return permissions.some(p => this.hasPermission(p));
    }
}

// å…¨å±€æƒé™ç®¡ç†å®ä¾‹
const permissionManager = new PermissionManager();

// Vueç»„ä»¶ä¸­ä½¿ç”¨æƒé™æ§åˆ¶
export default {
    data() {
        return {
            showCreateButton: false,
            showDeleteButton: false
        }
    },
    
    async mounted() {
        await permissionManager.initUserPermissions();
        
        // æ ¹æ®æƒé™æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
        this.showCreateButton = permissionManager.hasPermission('user:write');
        this.showDeleteButton = permissionManager.hasRole('ADMIN');
    }
}
```

---

## 6. ğŸ”„ å‰åç«¯è”è°ƒæµç¨‹è¯´æ˜


### 6.1 è”è°ƒå‡†å¤‡å·¥ä½œ


**ğŸ“‹ è”è°ƒå‰æ£€æŸ¥æ¸…å•**ï¼š

**åç«¯å‡†å¤‡**ï¼š
- âœ… è®¤è¯æ¥å£å¼€å‘å®Œæˆï¼š`/api/auth/login`
- âœ… æƒé™éªŒè¯æ¥å£ï¼š`/api/auth/verify`
- âœ… ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼š`/api/auth/user-info`
- âœ… Tokenåˆ·æ–°æ¥å£ï¼š`/api/auth/refresh`
- âœ… ç»Ÿä¸€å¼‚å¸¸å¤„ç†é…ç½®
- âœ… æ¥å£æ–‡æ¡£å‡†å¤‡ï¼ˆSwaggeræˆ–Postmanï¼‰

**å‰ç«¯å‡†å¤‡**ï¼š
- âœ… ç™»å½•é¡µé¢å¼€å‘å®Œæˆ
- âœ… Tokenå­˜å‚¨å’Œç®¡ç†å·¥å…·ç±»
- âœ… HTTPè¯·æ±‚æ‹¦æˆªå™¨é…ç½®
- âœ… è·¯ç”±æƒé™å®ˆå«
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶

### 6.2 è¯¦ç»†è”è°ƒæµç¨‹


**ğŸ”„ å®Œæ•´è”è°ƒæ—¶åºå›¾**ï¼š
```
å‰ç«¯                    ç½‘å…³                  è®¤è¯æœåŠ¡                æ•°æ®åº“
 â”‚                      â”‚                      â”‚                      â”‚
 â”‚â”€[1]POST /loginâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                      â”‚
 â”‚  {username,password}   â”‚â”€[2]è½¬å‘ç™»å½•è¯·æ±‚â”€â”€â”€â”€â–¶â”‚                      â”‚
 â”‚                       â”‚                      â”‚â”€[3]æŸ¥è¯¢ç”¨æˆ·â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                       â”‚                      â”‚â—€[4]è¿”å›ç”¨æˆ·ä¿¡æ¯â”€â”€â”€â”€â”€â”‚
 â”‚                       â”‚                      â”‚                      â”‚
 â”‚                       â”‚                      â”‚â”€[5]éªŒè¯å¯†ç           â”‚
 â”‚                       â”‚                      â”‚â”€[6]ç”ŸæˆJWT Token     â”‚
 â”‚                       â”‚â—€[7]è¿”å›Tokenâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
 â”‚â—€[8]ç™»å½•æˆåŠŸâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
 â”‚                       â”‚                      â”‚                      â”‚
 â”‚â”€[9]å­˜å‚¨Tokenåˆ°æœ¬åœ°â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
 â”‚                       â”‚                      â”‚                      â”‚
 â”‚â”€[10]GET /api/usersâ”€â”€â”€â”€â–¶â”‚                      â”‚                      â”‚
 â”‚  Header: Bearer Token  â”‚â”€[11]éªŒè¯Tokenâ”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚
 â”‚                       â”‚                      â”‚â”€[12]è§£æToken        â”‚
 â”‚                       â”‚                      â”‚â”€[13]æ£€æŸ¥æƒé™         â”‚
 â”‚                       â”‚â—€[14]æƒé™éªŒè¯é€šè¿‡â”€â”€â”€â”€â”€â”‚                      â”‚
 â”‚                       â”‚â”€[15]è½¬å‘åˆ°ä¸šåŠ¡æœåŠ¡â”€â”€â”€â–¶â”‚ä¸šåŠ¡æœåŠ¡               â”‚
 â”‚                       â”‚â—€[16]è¿”å›ä¸šåŠ¡æ•°æ®â”€â”€â”€â”€â”€â”€â”‚                      â”‚
 â”‚â—€[17]è·å¾—æ•°æ®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
```

### 6.3 å…³é”®è”è°ƒèŠ‚ç‚¹


**ğŸ¯ è”è°ƒå…³é”®æ£€æŸ¥ç‚¹**ï¼š

**ç¬¬ä¸€é˜¶æ®µï¼šç™»å½•åŠŸèƒ½è”è°ƒ**
```javascript
// å‰ç«¯ç™»å½•æµ‹è¯•
const testLogin = async () => {
    try {
        console.log('å¼€å§‹æµ‹è¯•ç™»å½•...');
        
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                username: 'testuser',
                password: 'testpass123'
            })
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
            console.log('âœ… ç™»å½•æˆåŠŸï¼ŒToken:', result.token);
            localStorage.setItem('token', result.token);
        } else {
            console.log('âŒ ç™»å½•å¤±è´¥:', result.message);
        }
    } catch (error) {
        console.log('âŒ ç½‘ç»œé”™è¯¯:', error.message);
    }
};
```

**ç¬¬äºŒé˜¶æ®µï¼šTokenéªŒè¯è”è°ƒ**
```javascript
// æµ‹è¯•TokenéªŒè¯
const testTokenValidation = async () => {
    const token = localStorage.getItem('token');
    if (!token) {
        console.log('âŒ æ²¡æœ‰Tokenï¼Œè¯·å…ˆç™»å½•');
        return;
    }
    
    try {
        const response = await fetch('/api/auth/verify', {
            method: 'GET',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (response.ok) {
            console.log('âœ… TokenéªŒè¯æˆåŠŸ');
        } else {
            console.log('âŒ TokenéªŒè¯å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
        }
    } catch (error) {
        console.log('âŒ TokenéªŒè¯å¼‚å¸¸:', error.message);
    }
};
```

**ç¬¬ä¸‰é˜¶æ®µï¼šä¸šåŠ¡æ¥å£è”è°ƒ**
```javascript
// æµ‹è¯•å¸¦æƒé™çš„ä¸šåŠ¡æ¥å£
const testBusinessApi = async () => {
    const token = localStorage.getItem('token');
    
    try {
        const response = await fetch('/api/users', {
            method: 'GET',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (response.ok) {
            const users = await response.json();
            console.log('âœ… è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ:', users);
        } else if (response.status === 401) {
            console.log('âŒ æœªæˆæƒï¼ŒTokenå¯èƒ½è¿‡æœŸ');
        } else if (response.status === 403) {
            console.log('âŒ æƒé™ä¸è¶³');
        }
    } catch (error) {
        console.log('âŒ ä¸šåŠ¡æ¥å£è°ƒç”¨å¼‚å¸¸:', error.message);
    }
};
```

### 6.4 å¸¸è§è”è°ƒé—®é¢˜åŠè§£å†³


**ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š

**é—®é¢˜1ï¼šè·¨åŸŸé—®é¢˜**
```javascript
// å‰ç«¯è§£å†³æ–¹æ¡ˆï¼ˆå¼€å‘ç¯å¢ƒï¼‰
// vue.config.js
module.exports = {
    devServer: {
        proxy: {
            '/api': {
                target: 'http://localhost:8080',  // åç«¯æœåŠ¡åœ°å€
                changeOrigin: true,
                pathRewrite: {
                    '^/api': '/api'
                }
            }
        }
    }
};

// åç«¯è§£å†³æ–¹æ¡ˆ
@CrossOrigin(origins = "http://localhost:3000")  // å…è®¸å‰ç«¯åŸŸå
@RestController
public class AuthController {
    // ...
}
```

**é—®é¢˜2ï¼šTokenæ ¼å¼é—®é¢˜**
```javascript
// æ­£ç¡®çš„Tokenä¼ é€’æ ¼å¼
const correctHeaders = {
    'Authorization': 'Bearer ' + token,  // æ³¨æ„Beareråé¢æœ‰ç©ºæ ¼
    'Content-Type': 'application/json'
};

// é”™è¯¯çš„æ ¼å¼
const wrongHeaders = {
    'Authorization': token,              // âŒ ç¼ºå°‘Bearerå‰ç¼€
    'token': token,                     // âŒ å­—æ®µåé”™è¯¯
    'Authorization': 'Bearer' + token   // âŒ Beareråé¢ç¼ºå°‘ç©ºæ ¼
};
```

**é—®é¢˜3ï¼šæƒé™æ£€æŸ¥å¤±è´¥**
```java
// åç«¯è°ƒè¯•æƒé™æ£€æŸ¥
@RestController
public class UserController {
    
    @GetMapping("/users")
    @RequirePermission("user:read")
    public ResponseEntity<?> getUsers(HttpServletRequest request) {
        // è°ƒè¯•ä¿¡æ¯
        String userId = request.getHeader("X-User-Id");
        System.out.println("å½“å‰ç”¨æˆ·ID: " + userId);
        
        List<String> permissions = permissionService.getUserPermissions(Long.parseLong(userId));
        System.out.println("ç”¨æˆ·æƒé™: " + permissions);
        
        boolean hasPermission = permissions.contains("user:read");
        System.out.println("æ˜¯å¦æœ‰user:readæƒé™: " + hasPermission);
        
        if (!hasPermission) {
            return ResponseEntity.status(403).body("æƒé™ä¸è¶³");
        }
        
        return ResponseEntity.ok(userService.getAllUsers());
    }
}
```

---

## 7. ğŸ” å¤šå› å­è®¤è¯å®ç°


### 7.1 ä»€ä¹ˆæ˜¯å¤šå› å­è®¤è¯


**ç®€å•ç†è§£**ï¼šå¤šå› å­è®¤è¯ï¼ˆMFAï¼‰å°±æ˜¯**å¤šé‡éªŒè¯**ï¼Œä¸åªæ˜¯ç”¨æˆ·åå¯†ç ï¼Œè¿˜è¦é¢å¤–çš„éªŒè¯æ–¹å¼ã€‚

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
é“¶è¡Œè½¬è´¦ï¼š                        å¤šå› å­è®¤è¯ï¼š
å¯†ç  + çŸ­ä¿¡éªŒè¯ç  + Uç›¾             å¯†ç  + çŸ­ä¿¡éªŒè¯ç  + è°·æ­ŒéªŒè¯å™¨

ä¸‰é‡ä¿æŠ¤ï¼š
1. ä½ çŸ¥é“çš„ï¼ˆå¯†ç ï¼‰                1. çŸ¥è¯†å› å­ï¼ˆå¯†ç ï¼‰
2. ä½ æ‹¥æœ‰çš„ï¼ˆæ‰‹æœºï¼‰                2. æŒæœ‰å› å­ï¼ˆæ‰‹æœº/ç¡¬ä»¶Tokenï¼‰
3. ä½ æœ¬äººçš„ï¼ˆæŒ‡çº¹ï¼‰                3. ç”Ÿç‰©å› å­ï¼ˆæŒ‡çº¹/äººè„¸ï¼‰
```

### 7.2 çŸ­ä¿¡éªŒè¯ç å®ç°


**ğŸ“± çŸ­ä¿¡éªŒè¯æµç¨‹**ï¼š
```java
@Service
public class SmsVerificationService {
    
    private final RedisTemplate<String, String> redisTemplate;
    private final SmsService smsService; // ç¬¬ä¸‰æ–¹çŸ­ä¿¡æœåŠ¡
    
    // å‘é€éªŒè¯ç 
    public boolean sendVerificationCode(String phone) {
        // 1. ç”Ÿæˆ6ä½éšæœºéªŒè¯ç 
        String code = generateRandomCode();
        
        // 2. å­˜å‚¨åˆ°Redisï¼Œ5åˆ†é’Ÿè¿‡æœŸ
        String key = "sms_code:" + phone;
        redisTemplate.opsForValue().set(key, code, 5, TimeUnit.MINUTES);
        
        // 3. å‘é€çŸ­ä¿¡
        try {
            smsService.sendSms(phone, "æ‚¨çš„éªŒè¯ç æ˜¯ï¼š" + code + "ï¼Œ5åˆ†é’Ÿå†…æœ‰æ•ˆã€‚");
            return true;
        } catch (Exception e) {
            log.error("å‘é€çŸ­ä¿¡å¤±è´¥", e);
            return false;
        }
    }
    
    // éªŒè¯éªŒè¯ç 
    public boolean verifyCode(String phone, String inputCode) {
        String key = "sms_code:" + phone;
        String storedCode = redisTemplate.opsForValue().get(key);
        
        if (storedCode == null) {
            return false; // éªŒè¯ç è¿‡æœŸæˆ–ä¸å­˜åœ¨
        }
        
        if (storedCode.equals(inputCode)) {
            // éªŒè¯æˆåŠŸï¼Œåˆ é™¤éªŒè¯ç 
            redisTemplate.delete(key);
            return true;
        }
        
        return false; // éªŒè¯ç é”™è¯¯
    }
    
    private String generateRandomCode() {
        return String.format("%06d", new Random().nextInt(1000000));
    }
}
```

**å‰ç«¯çŸ­ä¿¡éªŒè¯å®ç°**ï¼š
```javascript
class SmsVerification {
    constructor() {
        this.countdown = 0;
        this.timer = null;
    }
    
    // å‘é€éªŒè¯ç 
    async sendSmsCode(phone) {
        if (this.countdown > 0) {
            throw new Error(`è¯·ç­‰å¾…${this.countdown}ç§’åé‡è¯•`);
        }
        
        try {
            const response = await fetch('/api/auth/sms/send', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ phone })
            });
            
            const result = await response.json();
            if (result.success) {
                this.startCountdown(60); // 60ç§’å€’è®¡æ—¶
                return 'éªŒè¯ç å‘é€æˆåŠŸ';
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            throw new Error('å‘é€éªŒè¯ç å¤±è´¥ï¼š' + error.message);
        }
    }
    
    // å€’è®¡æ—¶åŠŸèƒ½
    startCountdown(seconds) {
        this.countdown = seconds;
        this.timer = setInterval(() => {
            this.countdown--;
            this.updateButtonText();
            
            if (this.countdown <= 0) {
                clearInterval(this.timer);
                this.updateButtonText();
            }
        }, 1000);
    }
    
    updateButtonText() {
        const button = document.getElementById('sms-btn');
        if (this.countdown > 0) {
            button.textContent = `é‡æ–°å‘é€(${this.countdown}s)`;
            button.disabled = true;
        } else {
            button.textContent = 'å‘é€éªŒè¯ç ';
            button.disabled = false;
        }
    }
}
```

### 7.3 TOTPè®¤è¯å™¨å®ç°


**ğŸ”¢ TOTPï¼ˆTime-based OTPï¼‰å®ç°**ï¼š
```java
@Service
public class TotpService {
    
    // ç”ŸæˆTOTPå¯†é’¥
    public String generateSecretKey() {
        SecureRandom random = new SecureRandom();
        byte[] bytes = new byte[32];
        random.nextBytes(bytes);
        return Base32.encode(bytes);
    }
    
    // ç”ŸæˆTOTPäºŒç»´ç URL
    public String generateQrCodeUrl(String username, String secretKey) {
        String appName = "MyApp";
        return String.format(
            "otpauth://totp/%s:%s?secret=%s&issuer=%s",
            appName, username, secretKey, appName
        );
    }
    
    // éªŒè¯TOTPç 
    public boolean verifyTotp(String secretKey, String inputCode) {
        try {
            long timeWindow = System.currentTimeMillis() / 30000; // 30ç§’æ—¶é—´çª—å£
            
            // å…è®¸å‰åä¸€ä¸ªæ—¶é—´çª—å£çš„è¯¯å·®
            for (int i = -1; i <= 1; i++) {
                String generatedCode = generateTotpCode(secretKey, timeWindow + i);
                if (generatedCode.equals(inputCode)) {
                    return true;
                }
            }
            return false;
        } catch (Exception e) {
            return false;
        }
    }
    
    private String generateTotpCode(String secretKey, long timeWindow) throws Exception {
        byte[] key = Base32.decode(secretKey);
        byte[] timeBytes = ByteBuffer.allocate(8).putLong(timeWindow).array();
        
        Mac mac = Mac.getInstance("HmacSHA1");
        mac.init(new SecretKeySpec(key, "HmacSHA1"));
        byte[] hash = mac.doFinal(timeBytes);
        
        int offset = hash[hash.length - 1] & 0xf;
        int code = ((hash[offset] & 0x7f) << 24) |
                   ((hash[offset + 1] & 0xff) << 16) |
                   ((hash[offset + 2] & 0xff) << 8) |
                   (hash[offset + 3] & 0xff);
        
        return String.format("%06d", code % 1000000);
    }
}
```

### 7.4 MFAç™»å½•æµç¨‹


**ğŸ”„ å¤šå› å­è®¤è¯ç™»å½•æµç¨‹**ï¼š
```java
@RestController
public class MfaAuthController {
    
    @PostMapping("/auth/mfa-login")
    public ResponseEntity<?> mfaLogin(@RequestBody MfaLoginRequest request) {
        // ç¬¬ä¸€æ­¥ï¼šéªŒè¯ç”¨æˆ·åå¯†ç 
        User user = userService.validateUser(request.getUsername(), request.getPassword());
        if (user == null) {
            return ResponseEntity.badRequest().body("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ç”¨äº†MFA
        if (!user.isMfaEnabled()) {
            // æ²¡æœ‰å¯ç”¨MFAï¼Œç›´æ¥ç™»å½•æˆåŠŸ
            String token = jwtTokenService.generateToken(user);
            return ResponseEntity.ok(new LoginResponse(token, "ç™»å½•æˆåŠŸ"));
        }
        
        // ç¬¬äºŒæ­¥ï¼šéªŒè¯MFA
        boolean mfaValid = false;
        
        // éªŒè¯çŸ­ä¿¡éªŒè¯ç 
        if (request.getSmsCode() != null) {
            mfaValid = smsVerificationService.verifyCode(user.getPhone(), request.getSmsCode());
        }
        // éªŒè¯TOTP
        else if (request.getTotpCode() != null) {
            mfaValid = totpService.verifyTotp(user.getTotpSecret(), request.getTotpCode());
        }
        
        if (!mfaValid) {
            return ResponseEntity.badRequest().body("å¤šå› å­è®¤è¯å¤±è´¥");
        }
        
        // MFAéªŒè¯æˆåŠŸï¼Œç”ŸæˆToken
        String token = jwtTokenService.generateToken(user);
        return ResponseEntity.ok(new LoginResponse(token, "ç™»å½•æˆåŠŸ"));
    }
}
```

---

## 8. ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤ç­–ç•¥


### 8.1 å¸¸è§å®‰å…¨å¨èƒ


**âš ï¸ è®¤è¯ç³»ç»Ÿé¢ä¸´çš„ä¸»è¦å¨èƒ**ï¼š

**å¯†ç æ”»å‡»**ï¼š
- ğŸ”¸ **æš´åŠ›ç ´è§£**ï¼šå°è¯•å„ç§å¯†ç ç»„åˆ
- ğŸ”¸ **å­—å…¸æ”»å‡»**ï¼šä½¿ç”¨å¸¸ç”¨å¯†ç åˆ—è¡¨
- ğŸ”¸ **å½©è™¹è¡¨æ”»å‡»**ï¼šä½¿ç”¨é¢„è®¡ç®—çš„å“ˆå¸Œè¡¨

**ä¼šè¯æ”»å‡»**ï¼š
- ğŸ”¸ **ä¼šè¯åŠ«æŒ**ï¼šçªƒå–ç”¨æˆ·çš„Sessionæˆ–Token
- ğŸ”¸ **ä¼šè¯å›ºå®š**ï¼šå¼ºåˆ¶ç”¨æˆ·ä½¿ç”¨æ”»å‡»è€…çš„ä¼šè¯ID
- ğŸ”¸ **CSRFæ”»å‡»**ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ 

### 8.2 å¯†ç å®‰å…¨ç­–ç•¥


**ğŸ” å¯†ç å¼ºåº¦è¦æ±‚**ï¼š
```java
@Component
public class PasswordValidator {
    
    public boolean isValidPassword(String password) {
        if (password == null || password.length() < 8) {
            return false;
        }
        
        // æ£€æŸ¥å¯†ç å¤æ‚åº¦
        boolean hasUpper = password.matches(".*[A-Z].*");      // åŒ…å«å¤§å†™å­—æ¯
        boolean hasLower = password.matches(".*[a-z].*");      // åŒ…å«å°å†™å­—æ¯
        boolean hasDigit = password.matches(".*\\d.*");        // åŒ…å«æ•°å­—
        boolean hasSpecial = password.matches(".*[!@#$%^&*].*"); // åŒ…å«ç‰¹æ®Šå­—ç¬¦
        
        // è‡³å°‘æ»¡è¶³3ç§å­—ç¬¦ç±»å‹
        int complexity = (hasUpper ? 1 : 0) + (hasLower ? 1 : 0) + 
                        (hasDigit ? 1 : 0) + (hasSpecial ? 1 : 0);
        
        return complexity >= 3;
    }
    
    public List<String> getPasswordSuggestions(String password) {
        List<String> suggestions = new ArrayList<>();
        
        if (password.length() < 8) {
            suggestions.add("å¯†ç é•¿åº¦è‡³å°‘8ä½");
        }
        if (!password.matches(".*[A-Z].*")) {
            suggestions.add("æ·»åŠ å¤§å†™å­—æ¯");
        }
        if (!password.matches(".*[a-z].*")) {
            suggestions.add("æ·»åŠ å°å†™å­—æ¯");
        }
        if (!password.matches(".*\\d.*")) {
            suggestions.add("æ·»åŠ æ•°å­—");
        }
        if (!password.matches(".*[!@#$%^&*].*")) {
            suggestions.add("æ·»åŠ ç‰¹æ®Šå­—ç¬¦");
        }
        
        return suggestions;
    }
}
```

### 8.3 ç™»å½•å¤±è´¥é™åˆ¶


**ğŸš« é˜²æš´åŠ›ç ´è§£æœºåˆ¶**ï¼š
```java
@Service
public class LoginAttemptService {
    
    private final RedisTemplate<String, Integer> redisTemplate;
    private final int MAX_ATTEMPTS = 5;      // æœ€å¤§å¤±è´¥æ¬¡æ•°
    private final int LOCK_DURATION = 300;   // é”å®šæ—¶é—´ï¼ˆç§’ï¼‰
    
    public void recordLoginFailure(String username, String ip) {
        // æŒ‰ç”¨æˆ·åé™åˆ¶
        String userKey = "login_fail:user:" + username;
        increaseFailureCount(userKey);
        
        // æŒ‰IPé™åˆ¶
        String ipKey = "login_fail:ip:" + ip;
        increaseFailureCount(ipKey);
    }
    
    public boolean isBlocked(String username, String ip) {
        String userKey = "login_fail:user:" + username;
        String ipKey = "login_fail:ip:" + ip;
        
        return getFailureCount(userKey) >= MAX_ATTEMPTS || 
               getFailureCount(ipKey) >= MAX_ATTEMPTS;
    }
    
    public void recordLoginSuccess(String username, String ip) {
        // ç™»å½•æˆåŠŸï¼Œæ¸…é™¤å¤±è´¥è®°å½•
        String userKey = "login_fail:user:" + username;
        String ipKey = "login_fail:ip:" + ip;
        
        redisTemplate.delete(userKey);
        redisTemplate.delete(ipKey);
    }
    
    private void increaseFailureCount(String key) {
        Integer count = redisTemplate.opsForValue().get(key);
        if (count == null) {
            redisTemplate.opsForValue().set(key, 1, LOCK_DURATION, TimeUnit.SECONDS);
        } else {
            redisTemplate.opsForValue().set(key, count + 1, LOCK_DURATION, TimeUnit.SECONDS);
        }
    }
    
    private int getFailureCount(String key) {
        Integer count = redisTemplate.opsForValue().get(key);
        return count != null ? count : 0;
    }
}
```

### 8.4 Tokenå®‰å…¨ç­–ç•¥


**ğŸ« Tokenå®‰å…¨æœ€ä½³å®è·µ**ï¼š

**Tokenè¿‡æœŸç­–ç•¥**ï¼š
```java
@Service
public class TokenSecurityService {
    
    private final long ACCESS_TOKEN_EXPIRE = 30 * 60 * 1000;    // 30åˆ†é’Ÿ
    private final long REFRESH_TOKEN_EXPIRE = 7 * 24 * 60 * 60 * 1000; // 7å¤©
    
    public TokenPair generateTokenPair(User user) {
        // ç”ŸæˆçŸ­æœŸè®¿é—®Token
        String accessToken = generateAccessToken(user);
        
        // ç”Ÿæˆé•¿æœŸåˆ·æ–°Token
        String refreshToken = generateRefreshToken(user);
        
        // å­˜å‚¨åˆ·æ–°Tokenåˆ°æ•°æ®åº“
        storeRefreshToken(user.getId(), refreshToken);
        
        return new TokenPair(accessToken, refreshToken);
    }
    
    public String refreshAccessToken(String refreshToken) {
        // éªŒè¯åˆ·æ–°Token
        if (!isValidRefreshToken(refreshToken)) {
            throw new SecurityException("åˆ·æ–°Tokenæ— æ•ˆ");
        }
        
        // è·å–ç”¨æˆ·ä¿¡æ¯
        Long userId = getUserIdFromRefreshToken(refreshToken);
        User user = userService.findById(userId);
        
        // ç”Ÿæˆæ–°çš„è®¿é—®Token
        return generateAccessToken(user);
    }
    
    private String generateAccessToken(User user) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("userId", user.getId());
        claims.put("type", "access");
        
        return Jwts.builder()
            .setClaims(claims)
            .setExpiration(new Date(System.currentTimeMillis() + ACCESS_TOKEN_EXPIRE))
            .signWith(SignatureAlgorithm.HS512, accessTokenSecret)
            .compact();
    }
    
    private String generateRefreshToken(User user) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("userId", user.getId());
        claims.put("type", "refresh");
        claims.put("tokenId", UUID.randomUUID().toString()); // å”¯ä¸€æ ‡è¯†
        
        return Jwts.builder()
            .setClaims(claims)
            .setExpiration(new Date(System.currentTimeMillis() + REFRESH_TOKEN_EXPIRE))
            .signWith(SignatureAlgorithm.HS512, refreshTokenSecret)
            .compact();
    }
}
```

### 8.5 è¯·æ±‚å®‰å…¨éªŒè¯


**ğŸ”’ APIè¯·æ±‚å®‰å…¨æ£€æŸ¥**ï¼š
```java
@Component
public class RequestSecurityFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // 1. æ£€æŸ¥è¯·æ±‚æ¥æº
        if (!isValidReferer(httpRequest)) {
            httpResponse.setStatus(403);
            return;
        }
        
        // 2. æ£€æŸ¥è¯·æ±‚é¢‘ç‡
        if (isRequestTooFrequent(httpRequest)) {
            httpResponse.setStatus(429); // Too Many Requests
            return;
        }
        
        // 3. æ£€æŸ¥å¯ç–‘User-Agent
        if (isSuspiciousUserAgent(httpRequest)) {
            logSuspiciousRequest(httpRequest);
        }
        
        chain.doFilter(request, response);
    }
    
    private boolean isValidReferer(HttpServletRequest request) {
        String referer = request.getHeader("Referer");
        String[] allowedDomains = {"https://myapp.com", "https://admin.myapp.com"};
        
        if (referer == null) {
            // å…è®¸ç›´æ¥è®¿é—®APIï¼Œä½†è®°å½•æ—¥å¿—
            return true;
        }
        
        return Arrays.stream(allowedDomains)
            .anyMatch(domain -> referer.startsWith(domain));
    }
    
    private boolean isRequestTooFrequent(HttpServletRequest request) {
        String clientIp = getClientIp(request);
        String key = "rate_limit:" + clientIp;
        
        // ä½¿ç”¨Rediså®ç°æ»‘åŠ¨çª—å£é™æµ
        // æ¯åˆ†é’Ÿæœ€å¤š100ä¸ªè¯·æ±‚
        return rateLimitService.isExceedLimit(key, 100, 60);
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 è®¤è¯ç³»ç»Ÿè®¾è®¡è¦ç‚¹


**ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™**ï¼š
- **èŒè´£åˆ†ç¦»**ï¼šè®¤è¯ä¸­å¿ƒç‹¬ç«‹ï¼Œä¸“é—¨è´Ÿè´£èº«ä»½éªŒè¯
- **æ— çŠ¶æ€è®¾è®¡**ï¼šä½¿ç”¨JWT Tokenï¼ŒæœåŠ¡ä¸ä¿å­˜ç”¨æˆ·çŠ¶æ€
- **æƒé™æœ€å°åŒ–**ï¼šç”¨æˆ·åªè·å¾—å¿…éœ€çš„æœ€å°æƒé™
- **å®‰å…¨ç¬¬ä¸€**ï¼šå¯†ç åŠ å¯†ã€Tokenç­¾åã€è¯·æ±‚éªŒè¯

### 9.2 å…³é”®æŠ€æœ¯æ€»ç»“


**ğŸ”§ æŠ€æœ¯é€‰å‹å¯¹æ¯”**ï¼š

| æŠ€æœ¯é€‰é¡¹ | **ä¼˜åŠ¿** | **åŠ£åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **Sessionè®¤è¯** | ç®€å•æ˜“æ‡‚ï¼ŒæœåŠ¡ç«¯æ§åˆ¶å¼º | ä¸é€‚åˆåˆ†å¸ƒå¼ï¼Œå ç”¨æœåŠ¡å™¨å†…å­˜ | å•ä½“åº”ç”¨ |
| **JWT Token** | æ— çŠ¶æ€ï¼Œé€‚åˆå¾®æœåŠ¡ | Tokenè¾ƒå¤§ï¼Œæ— æ³•ä¸»åŠ¨æ’¤é”€ | åˆ†å¸ƒå¼ç³»ç»Ÿ |
| **OAuth2** | æ ‡å‡†åŒ–ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹ç™»å½• | å¤æ‚åº¦é«˜ï¼Œéœ€è¦å¤šä¸ªæœåŠ¡ | å¼€æ”¾å¹³å° |

**ğŸ” å®‰å…¨ç­‰çº§åˆ’åˆ†**ï¼š

| å®‰å…¨ç­‰çº§ | **è®¤è¯æ–¹å¼** | **é€‚ç”¨ç³»ç»Ÿ** | **å®ç°æˆæœ¬** |
|---------|-------------|-------------|-------------|
| **åŸºç¡€çº§** | ç”¨æˆ·å+å¯†ç  | ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿ | ğŸŸ¢ ä½ |
| **ä¸­ç­‰çº§** | å¯†ç +çŸ­ä¿¡éªŒè¯ç  | ç”µå•†ã€ç¤¾äº¤å¹³å° | ğŸŸ¡ ä¸­ç­‰ |
| **é«˜ç­‰çº§** | å¤šå› å­è®¤è¯+ç¡¬ä»¶Token | é‡‘èã€æ”¯ä»˜ç³»ç»Ÿ | ğŸ”´ é«˜ |

### 9.3 å®æ–½å»ºè®®


**ğŸ“‹ é¡¹ç›®å®æ–½æ­¥éª¤**ï¼š

**é˜¶æ®µä¸€ï¼šåŸºç¡€è®¤è¯**
1. âœ… å®ç°ç”¨æˆ·æ³¨å†Œç™»å½•
2. âœ… JWT Tokenç”Ÿæˆå’ŒéªŒè¯
3. âœ… åŸºç¡€æƒé™æ§åˆ¶
4. âœ… å‰åç«¯è”è°ƒæµ‹è¯•

**é˜¶æ®µäºŒï¼šæƒé™å®Œå–„**
1. âœ… RBACæƒé™æ¨¡å‹è®¾è®¡
2. âœ… æ¥å£çº§æƒé™æ§åˆ¶
3. âœ… å‰ç«¯è·¯ç”±å®ˆå«
4. âœ… æƒé™ç®¡ç†ç•Œé¢

**é˜¶æ®µä¸‰ï¼šå®‰å…¨åŠ å›º**
1. âœ… å¤šå› å­è®¤è¯
2. âœ… ç™»å½•å¤±è´¥é™åˆ¶
3. âœ… è¯·æ±‚é¢‘ç‡é™åˆ¶
4. âœ… å®‰å…¨æ—¥å¿—è®°å½•

**âš ï¸ å¸¸è§å‘ç‚¹æé†’**ï¼š
- **Tokenè¿‡æœŸå¤„ç†**ï¼šå®ç°è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼Œé¿å…ç”¨æˆ·é¢‘ç¹é‡æ–°ç™»å½•
- **æƒé™ç²’åº¦æ§åˆ¶**ï¼šä¸è¦è®¾è®¡è¿‡äºå¤æ‚çš„æƒé™ä½“ç³»ï¼Œå¤Ÿç”¨å°±å¥½
- **å¯†ç å­˜å‚¨**ï¼šç»å¯¹ä¸èƒ½æ˜æ–‡å­˜å‚¨ï¼Œå¿…é¡»ä½¿ç”¨BCryptç­‰å®‰å…¨ç®—æ³•
- **è·¨åŸŸé…ç½®**ï¼šå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„è·¨åŸŸé…ç½®è¦åŒºåˆ†å¯¹å¾…
- **é”™è¯¯ä¿¡æ¯**ï¼šä¸è¦åœ¨é”™è¯¯ä¿¡æ¯ä¸­æ³„éœ²æ•æ„Ÿä¿¡æ¯

### 9.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ ä¼˜åŒ–ç­–ç•¥**ï¼š
- **æƒé™ç¼“å­˜**ï¼šå°†ç”¨æˆ·æƒé™ä¿¡æ¯ç¼“å­˜åˆ°Redisï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- **Tokenæœ¬åœ°éªŒè¯**ï¼šä½¿ç”¨JWTé¿å…æ¯æ¬¡è¯·æ±‚éƒ½æŸ¥è¯¢æ•°æ®åº“
- **æ¥å£åˆå¹¶**ï¼šå‡å°‘å‰ç«¯è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£è°ƒç”¨æ¬¡æ•°
- **å¼‚æ­¥æ—¥å¿—**ï¼šå®‰å…¨æ—¥å¿—è®°å½•ä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼Œä¸å½±å“æ¥å£å“åº”é€Ÿåº¦

**æ ¸å¿ƒè®°å¿†**ï¼š
- è®¤è¯ç³»ç»Ÿæ˜¯åº”ç”¨å®‰å…¨çš„ç¬¬ä¸€é“é˜²çº¿
- JWT Tokenæ˜¯ç°ä»£å¾®æœåŠ¡æ¶æ„çš„æ ‡å‡†é€‰æ‹©
- RBACæ¨¡å‹èƒ½æ»¡è¶³å¤§éƒ¨åˆ†ä¼ä¸šçº§æƒé™ç®¡ç†éœ€æ±‚
- å¤šå› å­è®¤è¯æ˜¯é«˜å®‰å…¨çº§åˆ«ç³»ç»Ÿçš„å¿…å¤‡åŠŸèƒ½
- å®‰å…¨é˜²æŠ¤è¦è€ƒè™‘å¤šä¸ªç»´åº¦ï¼šå¯†ç ã€Tokenã€è¯·æ±‚ã€æ—¥å¿—