---
title: 1ã€äº‘åŸç”Ÿè®¤è¯
---
## ğŸ“š ç›®å½•

1. [äº‘åŸç”Ÿè®¤è¯æ¦‚è¿°](#1-äº‘åŸç”Ÿè®¤è¯æ¦‚è¿°)
2. [Kubernetes RBACæƒé™æ§åˆ¶](#2-Kubernetes-RBACæƒé™æ§åˆ¶)
3. [Service Accountæœºåˆ¶è¯¦è§£](#3-Service-Accountæœºåˆ¶è¯¦è§£)
4. [å‡†å…¥æ§åˆ¶ç³»ç»Ÿ](#4-å‡†å…¥æ§åˆ¶ç³»ç»Ÿ)
5. [IstioæœåŠ¡ç½‘æ ¼è®¤è¯](#5-IstioæœåŠ¡ç½‘æ ¼è®¤è¯)
6. [ç½‘ç»œç­–ç•¥ä¸å®‰å…¨æ§åˆ¶](#6-ç½‘ç»œç­–ç•¥ä¸å®‰å…¨æ§åˆ¶)
7. [å®¹å™¨å®‰å…¨ä¸å¯†é’¥ç®¡ç†](#7-å®¹å™¨å®‰å…¨ä¸å¯†é’¥ç®¡ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. â˜ï¸ äº‘åŸç”Ÿè®¤è¯æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿè®¤è¯ï¼Ÿ


> **äº‘åŸç”Ÿè®¤è¯**ï¼šåœ¨å®¹å™¨åŒ–ã€å¾®æœåŠ¡ã€æœåŠ¡ç½‘æ ¼ç­‰äº‘åŸç”Ÿç¯å¢ƒä¸­ï¼Œç®¡ç†åº”ç”¨ã€æœåŠ¡ã€ç”¨æˆ·èº«ä»½å’Œæƒé™çš„å®‰å…¨æœºåˆ¶ã€‚
> 
> **é€šä¿—ç†è§£**ï¼šå°±åƒç»™ä¸€ä¸ªå·¨å¤§çš„"æ•°å­—åŸå¸‚"ï¼ˆKubernetesé›†ç¾¤ï¼‰åˆ¶å®šèº«ä»½è¯æ˜å’Œé€šè¡Œè§„åˆ™ï¼Œæ¯ä¸ª"å±…æ°‘"ï¼ˆPodã€æœåŠ¡ï¼‰éƒ½è¦æœ‰åˆæ³•èº«ä»½æ‰èƒ½åœ¨åŸå¸‚é‡Œæ´»åŠ¨ã€‚

**ğŸ™ï¸ ä¼ ç»Ÿè®¤è¯ vs äº‘åŸç”Ÿè®¤è¯å¯¹æ¯”**

```
ä¼ ç»Ÿå•ä½“åº”ç”¨è®¤è¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webåº”ç”¨       â”‚ â†â”€â”€ ç”¨æˆ·ç™»å½•
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ç”¨æˆ·è®¤è¯   â”‚ â”‚ â†â”€â”€ æ•°æ®åº“éªŒè¯
â”‚ â”‚  æƒé™æ§åˆ¶   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç®€å•ç›´æ¥ï¼Œä¸€ä¸ªåº”ç”¨æå®šæ‰€æœ‰è®¤è¯

äº‘åŸç”Ÿå¾®æœåŠ¡è®¤è¯ï¼š
        ç”¨æˆ·
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç½‘å…³è®¤è¯ â”‚ â†â”€â”€ ç»Ÿä¸€å…¥å£
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Kubernetesé›†ç¾¤        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚æœåŠ¡Aâ”‚  â”‚æœåŠ¡Bâ”‚  â”‚æœåŠ¡Câ”‚ â”‚ â†â”€â”€ æœåŠ¡é—´äº’ç›¸è®¤è¯
â”‚ â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â†“        â†“        â†“    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚   RBACæƒé™æ§åˆ¶ç³»ç»Ÿ      â”‚â”‚ â†â”€â”€ ç»Ÿä¸€æƒé™ç®¡ç†
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å¤æ‚ä½†å¼ºå¤§ï¼Œå¤šå±‚æ¬¡å®‰å…¨ä¿æŠ¤
```

### 1.2 äº‘åŸç”Ÿè®¤è¯çš„æ ¸å¿ƒæŒ‘æˆ˜


**ğŸ¯ ä¸»è¦æŒ‘æˆ˜å’Œè§£å†³æ€è·¯**

| **æŒ‘æˆ˜** | **ä¼ ç»Ÿç¯å¢ƒ** | **äº‘åŸç”Ÿç¯å¢ƒ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|---------------|-------------|
| **èº«ä»½ç®¡ç†** | `å›ºå®šæœåŠ¡å™¨ï¼ŒIPä¸å˜` | `Podéšæ—¶åˆ›å»ºé”€æ¯ï¼ŒIPå˜åŒ–` | `Service Account + Token` |
| **æƒé™æ§åˆ¶** | `ç”¨æˆ·æƒé™ï¼Œç›¸å¯¹ç®€å•` | `ç”¨æˆ·+æœåŠ¡+Podå¤šå±‚æƒé™` | `RBACå¤šç»´åº¦æƒé™` |
| **æœåŠ¡é€šä¿¡** | `å†…ç½‘é€šä¿¡ï¼Œç›¸å¯¹å®‰å…¨` | `å¾®æœåŠ¡å¤§é‡äº’ç›¸è°ƒç”¨` | `mTLSåŒå‘è®¤è¯` |
| **é…ç½®ç®¡ç†** | `é…ç½®æ–‡ä»¶ï¼Œæ‰‹å·¥ç»´æŠ¤` | `å¯†é’¥åˆ†å‘ï¼Œè‡ªåŠ¨è½®æ¢` | `Secret + CSIè‡ªåŠ¨ç®¡ç†` |

---

## 2. ğŸ” Kubernetes RBACæƒé™æ§åˆ¶


### 2.1 RBACæ˜¯ä»€ä¹ˆï¼Ÿé€šä¿—ç†è§£


> **RBAC**ï¼šRole-Based Access Controlï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰
> 
> **é€šä¿—æ¯”å–»**ï¼šå°±åƒå…¬å¸çš„é—¨ç¦å¡ç³»ç»Ÿã€‚ä½ çš„å·¥å¡ï¼ˆèº«ä»½ï¼‰+ èŒä½ï¼ˆè§’è‰²ï¼‰= èƒ½è¿›å“ªäº›é—¨ï¼ˆæƒé™ï¼‰

**ğŸ¢ RBACçš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µ**

```
RBACæƒé™æ¨¡å‹ï¼š

ğŸ‘¤ ç”¨æˆ·(User/ServiceAccount)
    "æˆ‘æ˜¯è°ï¼Ÿ" - èº«ä»½æ ‡è¯†
         â†“
ğŸ­ è§’è‰²(Role/ClusterRole)  
    "èƒ½åšä»€ä¹ˆï¼Ÿ" - æƒé™é›†åˆ
         â†“
ğŸ”— ç»‘å®š(RoleBinding/ClusterRoleBinding)
    "è°èƒ½åšä»€ä¹ˆï¼Ÿ" - ç”¨æˆ·ä¸è§’è‰²å…³è”
         â†“
ğŸ¯ èµ„æº(Resource)
    "æ“ä½œä»€ä¹ˆï¼Ÿ" - å…·ä½“çš„K8så¯¹è±¡

å®é™…ä¾‹å­ï¼š
å¼ ä¸‰(ServiceAccount) + å¼€å‘è€…(Role) = å¯ä»¥æŸ¥çœ‹Podä½†ä¸èƒ½åˆ é™¤
æå››(User) + ç®¡ç†å‘˜(ClusterRole) = å¯ä»¥æ“ä½œæ•´ä¸ªé›†ç¾¤æ‰€æœ‰èµ„æº
```

### 2.2 ç”¨æˆ·ç±»å‹è¯¦è§£


**ğŸ‘¥ Kubernetesä¸­çš„ä¸¤ç±»ç”¨æˆ·**

```yaml
# 1. æ™®é€šç”¨æˆ·(User) - çœŸå®çš„äºº
# Kubernetesä¸ç›´æ¥ç®¡ç†ï¼Œé€šè¿‡å¤–éƒ¨ç³»ç»Ÿè®¤è¯
# ä¾‹å¦‚ï¼šé€šè¿‡è¯ä¹¦ã€LDAPã€OIDCç­‰æ–¹å¼

# 2. æœåŠ¡è´¦å·(ServiceAccount) - ç¨‹åº/Podä½¿ç”¨
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-app-service-account
  namespace: default
```

> **ç†è§£è¦ç‚¹**ï¼š
> - **User**ï¼šç»™äººç”¨çš„ï¼Œæ¯”å¦‚å¼€å‘äººå‘˜ã€è¿ç»´äººå‘˜
> - **ServiceAccount**ï¼šç»™ç¨‹åºç”¨çš„ï¼Œæ¯”å¦‚åº”ç”¨Podã€ç›‘æ§ç³»ç»Ÿ

### 2.3 è§’è‰²(Role)è¯¦è§£


**ğŸ­ ä¸¤ç§è§’è‰²ç±»å‹**

```yaml
# 1. Role - å‘½åç©ºé—´çº§åˆ«æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: development  # åªåœ¨developmentå‘½åç©ºé—´æœ‰æ•ˆ
  name: pod-reader
rules:
- apiGroups: [""]         # æ ¸å¿ƒAPIç»„
  resources: ["pods"]     # èƒ½æ“ä½œä»€ä¹ˆèµ„æº
  verbs: ["get", "list"]  # èƒ½åšä»€ä¹ˆæ“ä½œ

---
# 2. ClusterRole - é›†ç¾¤çº§åˆ«æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-admin    # æ•´ä¸ªé›†ç¾¤éƒ½æœ‰æ•ˆ
rules:
- apiGroups: ["*"]       # æ‰€æœ‰APIç»„
  resources: ["*"]       # æ‰€æœ‰èµ„æº
  verbs: ["*"]          # æ‰€æœ‰æ“ä½œ
```

**ğŸ” å¸¸ç”¨æƒé™åŠ¨è¯(Verbs)è¯´æ˜**

| **åŠ¨è¯** | **å«ä¹‰** | **å¯¹åº”æ“ä½œ** | **ä½¿ç”¨åœºæ™¯** |
|---------|---------|-------------|-------------|
| `get` | **æŸ¥çœ‹å•ä¸ªèµ„æº** | `kubectl get pod my-pod` | `æŸ¥çœ‹ç‰¹å®šPodä¿¡æ¯` |
| `list` | **æŸ¥çœ‹èµ„æºåˆ—è¡¨** | `kubectl get pods` | `æŸ¥çœ‹æ‰€æœ‰Podåˆ—è¡¨` |
| `create` | **åˆ›å»ºèµ„æº** | `kubectl create deployment` | `éƒ¨ç½²æ–°åº”ç”¨` |
| `update` | **æ›´æ–°èµ„æº** | `kubectl patch deployment` | `ä¿®æ”¹åº”ç”¨é…ç½®` |
| `delete` | **åˆ é™¤èµ„æº** | `kubectl delete pod` | `åˆ é™¤Pod` |
| `watch` | **ç›‘æ§èµ„æºå˜åŒ–** | `kubectl get pods -w` | `å®æ—¶ç›‘æ§PodçŠ¶æ€` |

### 2.4 è§’è‰²ç»‘å®šè¯¦è§£


**ğŸ”— ç»‘å®šçš„ä¸¤ç§ç±»å‹**

```yaml
# 1. RoleBinding - åœ¨ç‰¹å®šå‘½åç©ºé—´ä¸­ç»‘å®š
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: development
subjects:
- kind: User
  name: jane@company.com    # ç»™ç”¨æˆ·janeæƒé™
  apiGroup: rbac.authorization.k8s.io
- kind: ServiceAccount
  name: my-app             # ç»™æœåŠ¡è´¦å·my-appæƒé™
  namespace: development
roleRef:
  kind: Role
  name: pod-reader         # ç»‘å®šåˆ°pod-readerè§’è‰²
  apiGroup: rbac.authorization.k8s.io

---
# 2. ClusterRoleBinding - é›†ç¾¤çº§åˆ«ç»‘å®š
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-admin-binding
subjects:
- kind: User
  name: admin@company.com   # ç»™adminç”¨æˆ·é›†ç¾¤ç®¡ç†å‘˜æƒé™
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
```

### 2.5 RBACå®æˆ˜ç¤ºä¾‹


**ğŸ› ï¸ åˆ›å»ºå¼€å‘å›¢é˜Ÿæƒé™**

```yaml
# 1. åˆ›å»ºå¼€å‘è€…è§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev-team
  name: developer
rules:
# å¯ä»¥ç®¡ç†Pod
- apiGroups: [""]
  resources: ["pods", "pods/log", "pods/exec"]
  verbs: ["*"]
# å¯ä»¥æŸ¥çœ‹æœåŠ¡å’Œé…ç½®
- apiGroups: [""]
  resources: ["services", "configmaps", "secrets"]
  verbs: ["get", "list"]
# å¯ä»¥ç®¡ç†éƒ¨ç½²
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["*"]

---
# 2. ä¸ºå¼€å‘äººå‘˜ç»‘å®šæƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: dev-team-binding
  namespace: dev-team
subjects:
- kind: User
  name: developer1@company.com
- kind: User  
  name: developer2@company.com
roleRef:
  kind: Role
  name: developer
  apiGroup: rbac.authorization.k8s.io

---
# 3. éªŒè¯æƒé™
# å¼€å‘è€…å¯ä»¥åšçš„ï¼š
# kubectl get pods -n dev-team          âœ… å¯ä»¥
# kubectl delete pod my-pod -n dev-team âœ… å¯ä»¥
# kubectl get pods -n production        âŒ ä¸å¯ä»¥ï¼ˆä¸åŒå‘½åç©ºé—´ï¼‰
# kubectl delete namespace dev-team     âŒ ä¸å¯ä»¥ï¼ˆæ²¡æœ‰é›†ç¾¤æƒé™ï¼‰
```

---

## 3. ğŸ¤– Service Accountæœºåˆ¶è¯¦è§£


### 3.1 Service Accountæ˜¯ä»€ä¹ˆï¼Ÿ


> **Service Account**ï¼šç»™Podï¼ˆå®¹å™¨åº”ç”¨ï¼‰ç”¨çš„"èº«ä»½è¯"ï¼Œè®©Podèƒ½å¤Ÿè°ƒç”¨Kubernetes APIæˆ–å…¶ä»–æœåŠ¡
> 
> **ç”Ÿæ´»æ¯”å–»**ï¼šå°±åƒç»™æœºå™¨äººåŠä¸€ä¸ª"å·¥ä½œè¯"ï¼Œæœºå™¨äººæ‹¿ç€è¿™ä¸ªè¯ä»¶æ‰èƒ½è¿›å…¥åŠå…¬æ¥¼ã€ä½¿ç”¨ç”µæ¢¯ã€æ‰“å°æ–‡ä»¶ç­‰

**ğŸ”„ ServiceAccountå·¥ä½œæµç¨‹**

```
Podå¯åŠ¨æµç¨‹ä¸­çš„èº«ä»½è®¤è¯ï¼š

1. Podåˆ›å»º
   â””â”€â”€ è‡ªåŠ¨åˆ†é…ServiceAccountï¼ˆå¦‚æœæ²¡æŒ‡å®šï¼Œç”¨defaultï¼‰

2. Tokenè‡ªåŠ¨æŒ‚è½½  
   â””â”€â”€ K8sè‡ªåŠ¨æŠŠTokenæ–‡ä»¶æŒ‚è½½åˆ°Podé‡Œ
       è·¯å¾„ï¼š/var/run/secrets/kubernetes.io/serviceaccount/

3. Podè°ƒç”¨API
   â””â”€â”€ ä½¿ç”¨Tokenå‘K8s API Serverè¯æ˜èº«ä»½

4. API ServeréªŒè¯
   â””â”€â”€ æ£€æŸ¥Tokenæœ‰æ•ˆæ€§å’Œæƒé™
```

### 3.2 Podè®¤è¯æœºåˆ¶


**ğŸ« è‡ªåŠ¨TokenæŒ‚è½½**

```yaml
# Podä¼šè‡ªåŠ¨æŒ‚è½½ServiceAccountçš„Token
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  serviceAccountName: my-service-account  # æŒ‡å®šä½¿ç”¨çš„ServiceAccount
  containers:
  - name: app
    image: my-app:latest
    # Kubernetesä¼šè‡ªåŠ¨æŒ‚è½½ä»¥ä¸‹æ–‡ä»¶åˆ°å®¹å™¨ä¸­ï¼š
    # /var/run/secrets/kubernetes.io/serviceaccount/token      - è®¤è¯Token
    # /var/run/secrets/kubernetes.io/serviceaccount/ca.crt     - CAè¯ä¹¦  
    # /var/run/secrets/kubernetes.io/serviceaccount/namespace  - å‘½åç©ºé—´
```

**ğŸ” åœ¨Podå†…éƒ¨æŸ¥çœ‹Token**

```bash
# è¿›å…¥Podå†…éƒ¨
kubectl exec -it my-app -- /bin/sh

# æŸ¥çœ‹è‡ªåŠ¨æŒ‚è½½çš„è®¤è¯ä¿¡æ¯
ls -la /var/run/secrets/kubernetes.io/serviceaccount/
# è¾“å‡ºï¼š
# token      - JWTæ ¼å¼çš„è®¤è¯ä»¤ç‰Œ
# ca.crt     - é›†ç¾¤çš„CAè¯ä¹¦
# namespace  - Podæ‰€åœ¨çš„å‘½åç©ºé—´

# æŸ¥çœ‹Tokenå†…å®¹ï¼ˆç»è¿‡base64ç¼–ç ï¼‰
cat /var/run/secrets/kubernetes.io/serviceaccount/token

# ä½¿ç”¨Tokenè°ƒç”¨K8s API
TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
curl -H "Authorization: Bearer $TOKEN" \
     -k https://kubernetes.default.svc.cluster.local/api/v1/namespaces/default/pods
```

### 3.3 Tokenè½®æ¢æœºåˆ¶


**ğŸ”„ è‡ªåŠ¨Tokenè½®æ¢**

```yaml
# Kubernetes 1.22+ç‰ˆæœ¬æ”¯æŒTokenè‡ªåŠ¨è½®æ¢
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-app-sa
# Tokenä¼šå®šæœŸè‡ªåŠ¨æ›´æ–°ï¼Œé»˜è®¤1å°æ—¶è½®æ¢ä¸€æ¬¡

---
# Podé…ç½®æ”¯æŒTokenè½®æ¢
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  serviceAccountName: my-app-sa
  containers:
  - name: app
    image: my-app:latest
    env:
    - name: TOKEN_PATH
      value: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    # åº”ç”¨éœ€è¦å®šæœŸé‡æ–°è¯»å–Tokenæ–‡ä»¶
```

**ğŸ’¡ åº”ç”¨å¦‚ä½•å¤„ç†Tokenè½®æ¢**

```python
# Pythonç¤ºä¾‹ï¼šå®šæœŸé‡æ–°è¯»å–Token
import time
import os
from kubernetes import client, config

class K8sClient:
    def __init__(self):
        self.token_path = "/var/run/secrets/kubernetes.io/serviceaccount/token"
        self.ca_cert_path = "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
        self.refresh_token()
        
    def refresh_token(self):
        """å®šæœŸåˆ·æ–°Token"""
        with open(self.token_path, 'r') as f:
            token = f.read().strip()
        
        # é…ç½®APIå®¢æˆ·ç«¯
        configuration = client.Configuration()
        configuration.host = "https://kubernetes.default.svc.cluster.local"
        configuration.ssl_ca_cert = self.ca_cert_path
        configuration.api_key = {"authorization": f"Bearer {token}"}
        
        self.api_client = client.ApiClient(configuration)
        self.v1 = client.CoreV1Api(self.api_client)
        
    def get_pods(self):
        """è·å–Podåˆ—è¡¨ï¼Œè‡ªåŠ¨å¤„ç†Tokenè½®æ¢"""
        try:
            return self.v1.list_pod_for_all_namespaces()
        except client.ApiException as e:
            if e.status == 401:  # Tokenè¿‡æœŸ
                self.refresh_token()  # é‡æ–°è¯»å–Token
                return self.v1.list_pod_for_all_namespaces()
            raise e
```

### 3.4 ServiceAccountå®æˆ˜é…ç½®


**ğŸ› ï¸ åˆ›å»ºè‡ªå®šä¹‰ServiceAccount**

```yaml
# 1. åˆ›å»ºServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: monitoring-sa
  namespace: monitoring

---
# 2. åˆ›å»ºè§’è‰²ï¼ˆèƒ½è¯»å–æ‰€æœ‰Podä¿¡æ¯ï¼‰
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: pod-reader
rules:
- apiGroups: [""]
  resources: ["pods", "nodes", "services"]
  verbs: ["get", "list", "watch"]

---
# 3. ç»‘å®šServiceAccountåˆ°è§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: monitoring-pod-reader
subjects:
- kind: ServiceAccount
  name: monitoring-sa
  namespace: monitoring
roleRef:
  kind: ClusterRole
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io

---
# 4. Podä½¿ç”¨è‡ªå®šä¹‰ServiceAccount
apiVersion: apps/v1
kind: Deployment
metadata:
  name: monitoring-app
  namespace: monitoring
spec:
  replicas: 1
  selector:
    matchLabels:
      app: monitoring
  template:
    metadata:
      labels:
        app: monitoring
    spec:
      serviceAccountName: monitoring-sa  # ä½¿ç”¨è‡ªå®šä¹‰ServiceAccount
      containers:
      - name: monitor
        image: prometheus/prometheus:latest
        # ç°åœ¨è¿™ä¸ªPodå°±æœ‰æƒé™è¯»å–é›†ç¾¤ä¸­æ‰€æœ‰Podçš„ä¿¡æ¯
```

---

## 4. ğŸšª å‡†å…¥æ§åˆ¶ç³»ç»Ÿ


### 4.1 å‡†å…¥æ§åˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ


> **å‡†å…¥æ§åˆ¶**ï¼šKubernetesçš„"å®‰æ£€ç³»ç»Ÿ"ï¼Œæ‰€æœ‰è¿›å…¥é›†ç¾¤çš„è¯·æ±‚éƒ½è¦ç»è¿‡å¤šé“å®‰æ£€
> 
> **æœºåœºå®‰æ£€æ¯”å–»**ï¼š
> - **èº«ä»½è®¤è¯**ï¼šæ£€æŸ¥èº«ä»½è¯ï¼ˆä½ æ˜¯è°ï¼Ÿï¼‰
> - **æˆæƒæ£€æŸ¥**ï¼šæ£€æŸ¥ç™»æœºç‰Œï¼ˆä½ èƒ½å»å“ªï¼Ÿï¼‰
> - **å®‰æ£€æ‰«æ**ï¼šæ£€æŸ¥è¡Œæå†…å®¹ï¼ˆä½ å¸¦äº†ä»€ä¹ˆï¼Ÿï¼‰
> - **æœ€ç»ˆæ£€æŸ¥**ï¼šç¡®è®¤ä¸€åˆ‡OKæ‰èƒ½ç™»æœº

**ğŸ” å‡†å…¥æ§åˆ¶æµç¨‹**

```
APIè¯·æ±‚å¤„ç†æµç¨‹ï¼š

å®¢æˆ·ç«¯è¯·æ±‚
    â†“
1. è®¤è¯(Authentication)
   "ä½ æ˜¯è°ï¼Ÿ" - éªŒè¯Token/è¯ä¹¦
    â†“
2. æˆæƒ(Authorization) 
   "ä½ èƒ½åšå—ï¼Ÿ" - æ£€æŸ¥RBACæƒé™
    â†“
3. å˜æ›´å‡†å…¥(Mutating Admission)
   "éœ€è¦ä¿®æ”¹å—ï¼Ÿ" - è‡ªåŠ¨æ·»åŠ /ä¿®æ”¹é…ç½®
    â†“
4. éªŒè¯å‡†å…¥(Validating Admission)
   "é…ç½®å¯¹å—ï¼Ÿ" - éªŒè¯æœ€ç»ˆé…ç½®
    â†“
5. å­˜å‚¨åˆ°etcd
   "ä¿å­˜æˆåŠŸï¼"
```

### 4.2 è®¤è¯(Authentication)è¯¦è§£


**ğŸ”‘ å››ç§ä¸»è¦è®¤è¯æ–¹å¼**

```yaml
# 1. ServiceAccount Tokenè®¤è¯ï¼ˆæœ€å¸¸ç”¨ï¼‰
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  serviceAccountName: my-service-account
  # è‡ªåŠ¨ä½¿ç”¨Tokenè®¤è¯

# 2. å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯
# kubectlä½¿ç”¨çš„æ–¹å¼ï¼Œé€šè¿‡è¯ä¹¦æ–‡ä»¶
apiVersion: v1
kind: Config
users:
- name: kubernetes-admin
  user:
    client-certificate: /path/to/client.crt
    client-key: /path/to/client.key

# 3. é™æ€Tokenè®¤è¯ï¼ˆä¸æ¨èï¼‰
# API Serverå¯åŠ¨å‚æ•°: --token-auth-file=tokens.csv
# tokens.csvå†…å®¹:
# token123,user1,uid1,"group1,group2"

# 4. OIDCè®¤è¯ï¼ˆä¼ä¸šé›†æˆï¼‰
# API Serveré…ç½®ï¼š
# --oidc-issuer-url=https://accounts.google.com
# --oidc-client-id=kubernetes
# --oidc-username-claim=email
```

### 4.3 æˆæƒ(Authorization)è¯¦è§£


**âš–ï¸ äº”ç§æˆæƒæ¨¡å¼**

```yaml
# API Serveré…ç½®æˆæƒæ¨¡å¼ï¼ˆæŒ‰é¡ºåºæ£€æŸ¥ï¼‰
# --authorization-mode=Node,RBAC,AlwaysAllow

# 1. Nodeæˆæƒ - kubeletè®¿é—®API
# kubeletåªèƒ½è®¿é—®è‡ªå·±èŠ‚ç‚¹ä¸Šçš„èµ„æº

# 2. RBACæˆæƒ - åŸºäºè§’è‰²ï¼ˆæœ€å¸¸ç”¨ï¼‰
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: developer
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]

# 3. ABACæˆæƒ - åŸºäºå±æ€§ï¼ˆå¤æ‚ï¼Œå¾ˆå°‘ç”¨ï¼‰
# é€šè¿‡JSONæ–‡ä»¶å®šä¹‰ç­–ç•¥

# 4. Webhookæˆæƒ - å¤–éƒ¨æœåŠ¡å†³å®š
# API Serverè°ƒç”¨å¤–éƒ¨æœåŠ¡åˆ¤æ–­æƒé™

# 5. AlwaysAllow - å…è®¸æ‰€æœ‰ï¼ˆå±é™©ï¼Œä»…æµ‹è¯•ç”¨ï¼‰
```

### 4.4 å˜æ›´å‡†å…¥æ§åˆ¶(Mutating Admission)


**ğŸ”§ è‡ªåŠ¨ä¿®æ”¹è¯·æ±‚å†…å®¹**

```yaml
# å¸¸è§çš„Mutating Admission Controllerï¼š

# 1. DefaultStorageClass - è‡ªåŠ¨æ·»åŠ é»˜è®¤å­˜å‚¨ç±»
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
# è‡ªåŠ¨æ·»åŠ ï¼šstorageClassName: default

# 2. NamespaceLifecycle - è‡ªåŠ¨è®¾ç½®å‘½åç©ºé—´
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  # å¦‚æœæ²¡æœ‰æŒ‡å®šnamespaceï¼Œè‡ªåŠ¨è®¾ç½®ä¸ºdefault
spec:
  containers:
  - name: app
    image: nginx

# 3. ServiceAccount - è‡ªåŠ¨æ·»åŠ ServiceAccount
apiVersion: v1
kind: Pod  
metadata:
  name: my-pod
spec:
  # å¦‚æœæ²¡æœ‰æŒ‡å®šserviceAccountNameï¼Œè‡ªåŠ¨è®¾ç½®ä¸ºdefault
  containers:
  - name: app
    image: nginx
```

### 4.5 éªŒè¯å‡†å…¥æ§åˆ¶(Validating Admission)


**âœ… éªŒè¯é…ç½®æ­£ç¡®æ€§**

```yaml
# å¸¸è§çš„Validating Admission Controllerï¼š

# 1. ResourceQuota - éªŒè¯èµ„æºé™é¢
apiVersion: v1
kind: ResourceQuota
metadata:
  name: compute-quota
  namespace: development
spec:
  hard:
    requests.cpu: "1000m"
    requests.memory: 2Gi
    pods: "10"

# å¦‚æœPodè¯·æ±‚è¶…å‡ºé™é¢ï¼Œä¼šè¢«æ‹’ç»ï¼š
apiVersion: v1
kind: Pod
metadata:
  name: big-pod
  namespace: development
spec:
  containers:
  - name: app
    image: nginx
    resources:
      requests:
        cpu: "2000m"    # è¶…å‡ºé™é¢ï¼Œä¼šè¢«æ‹’ç»
        memory: "4Gi"

# 2. PodSecurityPolicy - éªŒè¯Podå®‰å…¨ç­–ç•¥
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: restricted
spec:
  privileged: false           # ä¸å…è®¸ç‰¹æƒå®¹å™¨
  allowPrivilegeEscalation: false
  requiredDropCapabilities:
    - ALL
  runAsUser:
    rule: 'MustRunAsNonRoot'  # å¿…é¡»ä»¥érootç”¨æˆ·è¿è¡Œ
```

**ğŸ› ï¸ è‡ªå®šä¹‰å‡†å…¥æ§åˆ¶Webhook**

```yaml
# è‡ªå®šä¹‰éªŒè¯Webhook
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingAdmissionWebhook
metadata:
  name: validate-pod-labels
webhooks:
- name: pod-label-validator.company.com
  clientConfig:
    service:
      name: admission-webhook-service
      namespace: webhook-system
      path: "/validate"
  rules:
  - operations: ["CREATE", "UPDATE"]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  # è¿™ä¸ªWebhookä¼šéªŒè¯æ‰€æœ‰Podå¿…é¡»æœ‰ç‰¹å®šæ ‡ç­¾
```

---

## 5. ğŸ•¸ï¸ IstioæœåŠ¡ç½‘æ ¼è®¤è¯


### 5.1 ä»€ä¹ˆæ˜¯IstioæœåŠ¡ç½‘æ ¼ï¼Ÿ


> **IstioæœåŠ¡ç½‘æ ¼**ï¼šç»™å¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡åŠ ä¸Šä¸€å±‚"æ™ºèƒ½äº¤é€šç®¡ç†ç³»ç»Ÿ"
> 
> **åŸå¸‚äº¤é€šæ¯”å–»**ï¼š
> - **ä¼ ç»Ÿå¾®æœåŠ¡**ï¼šæ±½è½¦ç›´æ¥äº’ç›¸é€šä¿¡ï¼Œå®¹æ˜“å µè½¦å’Œäº‹æ•…
> - **IstioæœåŠ¡ç½‘æ ¼**ï¼šæ¯è¾†è½¦éƒ½æœ‰æ™ºèƒ½å¯¼èˆªï¼Œç»Ÿä¸€äº¤é€šç®¡åˆ¶ï¼Œå®‰å…¨é«˜æ•ˆ

**ğŸŒ Istioæ¶æ„æ¦‚è§ˆ**

```
IstioæœåŠ¡ç½‘æ ¼æ¶æ„ï¼š

                æ§åˆ¶å¹³é¢(Control Plane)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
        â”‚  â”‚  Pilot  â”‚  â”‚ Citadel â”‚           â”‚
        â”‚  â”‚(æµé‡ç®¡ç†) â”‚  â”‚(å®‰å…¨ç®¡ç†)â”‚           â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                  æ•°æ®å¹³é¢(Data Plane)
        
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   æœåŠ¡A     â”‚        â”‚   æœåŠ¡B     â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚  åº”ç”¨   â”‚ â”‚  mTLS  â”‚ â”‚  åº”ç”¨   â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â†â”€â”€â”€â”€â†’ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ Envoy   â”‚ â”‚        â”‚ â”‚ Envoy   â”‚ â”‚
    â”‚ â”‚ (ä»£ç†)  â”‚ â”‚        â”‚ â”‚ (ä»£ç†)  â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å¾®æœåŠ¡é—´è®¤è¯


**ğŸ” mTLSåŒå‘è®¤è¯**

> **mTLS**ï¼šMutual TLSï¼ŒåŒå‘TLSè®¤è¯ï¼ŒæœåŠ¡Aå’ŒæœåŠ¡Bç›¸äº’éªŒè¯å¯¹æ–¹èº«ä»½
> 
> **æ¡æ‰‹è¿‡ç¨‹æ¯”å–»**ï¼šä¸¤ä¸ªé™Œç”Ÿäººè§é¢ï¼Œéƒ½å‡ºç¤ºèº«ä»½è¯äº’ç›¸ç¡®è®¤èº«ä»½æ‰å¼€å§‹äº¤æµ

```yaml
# 1. å¯ç”¨è‡ªåŠ¨mTLS
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: production
spec:
  mtls:
    mode: STRICT  # å¼ºåˆ¶æ‰€æœ‰é€šä¿¡ä½¿ç”¨mTLS
```

**ğŸ”’ mTLSå·¥ä½œåŸç†**

```
æœåŠ¡é—´mTLSè®¤è¯è¿‡ç¨‹ï¼š

1. æœåŠ¡Aè°ƒç”¨æœåŠ¡B
   â””â”€â”€ Açš„Envoyä»£ç†æ‹¦æˆªè¯·æ±‚

2. å»ºç«‹TLSè¿æ¥
   â”œâ”€â”€ Aå‡ºç¤ºè‡ªå·±çš„è¯ä¹¦ç»™B
   â”œâ”€â”€ BéªŒè¯Açš„è¯ä¹¦æœ‰æ•ˆæ€§
   â”œâ”€â”€ Bå‡ºç¤ºè‡ªå·±çš„è¯ä¹¦ç»™A  
   â””â”€â”€ AéªŒè¯Bçš„è¯ä¹¦æœ‰æ•ˆæ€§

3. åŒå‘éªŒè¯æˆåŠŸ
   â””â”€â”€ å»ºç«‹åŠ å¯†é€šé“ï¼Œä¼ è¾“æ•°æ®

4. Citadelè‡ªåŠ¨ç®¡ç†è¯ä¹¦
   â”œâ”€â”€ è‡ªåŠ¨é¢å‘è¯ä¹¦
   â”œâ”€â”€ å®šæœŸè½®æ¢è¯ä¹¦
   â””â”€â”€ æ’¤é”€è¿‡æœŸè¯ä¹¦
```

**ğŸ› ï¸ é…ç½®æœåŠ¡é—´è®¤è¯**

```yaml
# 1. ä¸ºç‰¹å®šæœåŠ¡é…ç½®è®¤è¯ç­–ç•¥
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: order-service-mtls
  namespace: production
spec:
  selector:
    matchLabels:
      app: order-service
  mtls:
    mode: STRICT

---
# 2. é…ç½®æˆæƒç­–ç•¥
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: order-service-authz
  namespace: production
spec:
  selector:
    matchLabels:
      app: order-service
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/production/sa/user-service"]
        # åªå…è®¸user-serviceè°ƒç”¨order-service
  - to:
    - operation:
        methods: ["GET", "POST"]
        # åªå…è®¸GETå’ŒPOSTæ“ä½œ
```

### 5.3 Istioå®‰å…¨ç­–ç•¥è¯¦è§£


**ğŸ” è®¤è¯(AuthN)ç­–ç•¥**

```yaml
# 1. JWT Tokenè®¤è¯ï¼ˆå¯¹å¤–éƒ¨ç”¨æˆ·ï¼‰
apiVersion: security.istio.io/v1beta1
kind: RequestAuthentication
metadata:
  name: jwt-auth
  namespace: production
spec:
  selector:
    matchLabels:
      app: api-gateway
  jwtRules:
  - issuer: "https://accounts.google.com"
    jwksUri: "https://www.googleapis.com/oauth2/v3/certs"
    # éªŒè¯JWT Tokençš„æœ‰æ•ˆæ€§

---
# 2. æ··åˆè®¤è¯ç­–ç•¥
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: mixed-auth
  namespace: production
spec:
  selector:
    matchLabels:
      app: api-service
  mtls:
    mode: PERMISSIVE  # å…è®¸mTLSå’Œæ˜æ–‡é€šä¿¡å…±å­˜
  portLevelMtls:
    9000:
      mode: STRICT    # 9000ç«¯å£å¼ºåˆ¶mTLS
    8080:
      mode: DISABLE   # 8080ç«¯å£ç¦ç”¨mTLS
```

**âš–ï¸ æˆæƒ(AuthZ)ç­–ç•¥**

```yaml
# 1. åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: role-based-access
  namespace: production
spec:
  selector:
    matchLabels:
      app: admin-panel
  rules:
  - from:
    - source:
        requestPrincipals: ["*"]  # ä»»ä½•å·²è®¤è¯ç”¨æˆ·
  - when:
    - key: request.auth.claims[role]
      values: ["admin", "manager"]  # åªå…è®¸adminå’Œmanagerè§’è‰²

---  
# 2. åŸºäºæ—¶é—´å’ŒIPçš„è®¿é—®æ§åˆ¶
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: time-ip-based-access
  namespace: production
spec:
  selector:
    matchLabels:
      app: sensitive-service
  rules:
  - from:
    - source:
        ipBlocks: ["10.0.0.0/8"]  # åªå…è®¸å†…ç½‘IP
  - when:
    - key: request.time.hour
      values: ["9", "10", "11", "14", "15", "16", "17"]  # åªå…è®¸å·¥ä½œæ—¶é—´
```

**ğŸš« æ‹’ç»ç­–ç•¥**

```yaml
# æ‹’ç»ç‰¹å®šè¯·æ±‚
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: deny-all
  namespace: production
spec:
  selector:
    matchLabels:
      app: secret-service
  action: DENY  # æ‹’ç»è®¿é—®
  rules:
  - from:
    - source:
        notNamespaces: ["production"]  # æ‹’ç»éproductionå‘½åç©ºé—´çš„è®¿é—®
```

---

## 6. ğŸŒ ç½‘ç»œç­–ç•¥ä¸å®‰å…¨æ§åˆ¶


### 6.1 ç½‘ç»œç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ


> **ç½‘ç»œç­–ç•¥**ï¼šKubernetesçš„"é˜²ç«å¢™"ï¼Œæ§åˆ¶Podä¹‹é—´çš„ç½‘ç»œé€šä¿¡
> 
> **å°åŒºå®‰ä¿æ¯”å–»**ï¼š
> - **æ²¡æœ‰ç½‘ç»œç­–ç•¥**ï¼šå°åŒºå¤§é—¨æ•å¼€ï¼Œä»»ä½•äººéƒ½èƒ½è¿›å‡º
> - **æœ‰ç½‘ç»œç­–ç•¥**ï¼šé—¨å«æ£€æŸ¥ï¼Œåªæœ‰ç¬¦åˆæ¡ä»¶çš„äººæ‰èƒ½è¿›å…¥ç‰¹å®šæ¥¼æ ‹

**ğŸš§ é»˜è®¤è¡Œä¸º vs ç½‘ç»œç­–ç•¥**

```
æ²¡æœ‰ç½‘ç»œç­–ç•¥æ—¶ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod A  â”‚ â†â†’ â”‚  Pod B  â”‚ â†â†’ â”‚  Pod C  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ‰€æœ‰Podå¯ä»¥äº’ç›¸é€šä¿¡ï¼Œæ— ä»»ä½•é™åˆ¶

æœ‰ç½‘ç»œç­–ç•¥æ—¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod A  â”‚ â†â†’ â”‚  Pod B  â”‚ âœ—â†’ â”‚  Pod C  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
åªæœ‰è¢«æ˜ç¡®å…è®¸çš„é€šä¿¡æ‰èƒ½å»ºç«‹
```

### 6.2 Podé€šä¿¡æ§åˆ¶


**ğŸ“¡ å…¥ç«™(Ingress)è§„åˆ™**

```yaml
# æ§åˆ¶è°èƒ½è®¿é—®æˆ‘çš„Pod
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: web-app-ingress
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: web-app      # ä½œç”¨äºæ ‡ç­¾ä¸ºapp=web-appçš„Pod
  policyTypes:
  - Ingress           # åªå®šä¹‰å…¥ç«™è§„åˆ™
  ingress:
  - from:
    # è§„åˆ™1ï¼šå…è®¸æ¥è‡ªç‰¹å®šPodçš„è®¿é—®
    - podSelector:
        matchLabels:
          app: frontend
    # è§„åˆ™2ï¼šå…è®¸æ¥è‡ªç‰¹å®šå‘½åç©ºé—´çš„è®¿é—®
    - namespaceSelector:
        matchLabels:
          name: dmz
    # è§„åˆ™3ï¼šå…è®¸æ¥è‡ªç‰¹å®šIPçš„è®¿é—®
    - ipBlock:
        cidr: 192.168.1.0/24
        except:
        - 192.168.1.10/32  # æ’é™¤è¿™ä¸ªIP
    ports:
    - protocol: TCP
      port: 8080          # åªå…è®¸è®¿é—®8080ç«¯å£
```

**ğŸ“¤ å‡ºç«™(Egress)è§„åˆ™**

```yaml
# æ§åˆ¶æˆ‘çš„Podèƒ½è®¿é—®è°
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: database-egress
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: database    # ä½œç”¨äºæ•°æ®åº“Pod
  policyTypes:
  - Egress          # åªå®šä¹‰å‡ºç«™è§„åˆ™
  egress:
  - to:
    # å…è®¸è®¿é—®DNSæœåŠ¡
    - namespaceSelector:
        matchLabels:
          name: kube-system
    - podSelector:
        matchLabels:
          k8s-app: kube-dns
    ports:
    - protocol: UDP
      port: 53
  - to:
    # å…è®¸è®¿é—®å¤–éƒ¨API
    - ipBlock:
        cidr: 0.0.0.0/0    # å…è®¸è®¿é—®æ‰€æœ‰å¤–éƒ¨IP
    ports:
    - protocol: TCP
      port: 443           # åªèƒ½ä½¿ç”¨HTTPS
```

### 6.3 æœåŠ¡è®¿é—®æ§åˆ¶


**ğŸ¯ å¾®æœåŠ¡é€šä¿¡ç­–ç•¥**

```yaml
# ä¸‰å±‚æ¶æ„çš„ç½‘ç»œç­–ç•¥
# 1. å‰ç«¯å±‚ç­–ç•¥
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: frontend-policy
  namespace: production
spec:
  podSelector:
    matchLabels:
      tier: frontend
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - ipBlock:
        cidr: 0.0.0.0/0   # å…è®¸æ¥è‡ªå¤–éƒ¨çš„è®¿é—®
    ports:
    - protocol: TCP
      port: 80
  egress:
  - to:
    - podSelector:
        matchLabels:
          tier: backend   # åªèƒ½è®¿é—®åç«¯æœåŠ¡
    ports:
    - protocol: TCP
      port: 8080

---
# 2. åç«¯å±‚ç­–ç•¥
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: backend-policy
  namespace: production
spec:
  podSelector:
    matchLabels:
      tier: backend
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          tier: frontend  # åªæ¥å—å‰ç«¯çš„è®¿é—®
    ports:
    - protocol: TCP
      port: 8080
  egress:
  - to:
    - podSelector:
        matchLabels:
          tier: database  # åªèƒ½è®¿é—®æ•°æ®åº“
    ports:
    - protocol: TCP
      port: 5432

---
# 3. æ•°æ®åº“å±‚ç­–ç•¥
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: database-policy
  namespace: production
spec:
  podSelector:
    matchLabels:
      tier: database
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          tier: backend   # åªæ¥å—åç«¯çš„è®¿é—®
    ports:
    - protocol: TCP
      port: 5432
  # æ²¡æœ‰å®šä¹‰egressè§„åˆ™ï¼Œé»˜è®¤å…è®¸æ‰€æœ‰å‡ºç«™
```

### 6.4 å…¥å‡ºè§„åˆ™æœ€ä½³å®è·µ


**ğŸ† ç½‘ç»œç­–ç•¥æœ€ä½³å®è·µ**

```yaml
# 1. é»˜è®¤æ‹’ç»æ‰€æœ‰ç­–ç•¥ï¼ˆå…ˆç¦æ­¢ï¼Œå†å¼€æ”¾ï¼‰
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: production
spec:
  podSelector: {}  # é€‰æ‹©æ‰€æœ‰Pod
  policyTypes:
  - Ingress
  - Egress
  # æ²¡æœ‰å®šä¹‰ä»»ä½•è§„åˆ™ï¼Œé»˜è®¤æ‹’ç»æ‰€æœ‰æµé‡

---
# 2. å…è®¸DNSæŸ¥è¯¢ï¼ˆå¿…éœ€çš„åŸºç¡€æœåŠ¡ï¼‰
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: production
spec:
  podSelector: {}
  policyTypes:
  - Egress
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: UDP
      port: 53

---
# 3. å…è®¸å¥åº·æ£€æŸ¥ï¼ˆé¿å…æœåŠ¡ä¸å¯ç”¨ï¼‰
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-health-check
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: web-app
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: TCP
      port: 8080
      # å…è®¸kubeletå¥åº·æ£€æŸ¥
```

**ğŸ” ç½‘ç»œç­–ç•¥è°ƒè¯•**

```bash
# 1. æŸ¥çœ‹ç½‘ç»œç­–ç•¥
kubectl get networkpolicy -n production

# 2. æŸ¥çœ‹ç­–ç•¥è¯¦æƒ…
kubectl describe networkpolicy web-app-ingress -n production

# 3. æµ‹è¯•ç½‘ç»œè¿é€šæ€§
kubectl run test-pod --image=busybox -n production --rm -it -- sh
# åœ¨Podå†…æµ‹è¯•è¿æ¥
nc -zv target-service 8080

# 4. æŸ¥çœ‹ç½‘ç»œç­–ç•¥æ—¥å¿—ï¼ˆéœ€è¦CNIæ”¯æŒï¼‰
kubectl logs -n kube-system -l k8s-app=calico-node
```

---

## 7. ğŸ›¡ï¸ å®¹å™¨å®‰å…¨ä¸å¯†é’¥ç®¡ç†


### 7.1 å®¹å™¨é•œåƒå®‰å…¨


**ğŸ“¦ é•œåƒå®‰å…¨çš„å››ä¸ªå…³é”®ç¯èŠ‚**

```
å®¹å™¨é•œåƒå®‰å…¨æµç¨‹ï¼š

1. æ„å»ºé˜¶æ®µ        2. å­˜å‚¨é˜¶æ®µ        3. éƒ¨ç½²é˜¶æ®µ        4. è¿è¡Œé˜¶æ®µ
   â””â”€â”€ åŸºç¡€é•œåƒé€‰æ‹©    â””â”€â”€ é•œåƒç­¾åéªŒè¯    â””â”€â”€ æ¼æ´æ‰«æ       â””â”€â”€ è¿è¡Œæ—¶ç›‘æ§
   â””â”€â”€ æ¼æ´æ‰«æ       â””â”€â”€ å¯ä¿¡ä»“åº“å­˜å‚¨    â””â”€â”€ å‡†å…¥æ§åˆ¶       â””â”€â”€ è¡Œä¸ºæ£€æµ‹
```

### 7.2 é•œåƒç­¾åéªŒè¯


**âœï¸ ç¡®ä¿é•œåƒæ¥æºå¯ä¿¡**

```yaml
# 1. ä½¿ç”¨Cosignå¯¹é•œåƒè¿›è¡Œç­¾å
# æ„å»ºå¹¶ç­¾åé•œåƒ
docker build -t myapp:v1.0 .
docker push myapp:v1.0

# ä½¿ç”¨Cosignç­¾å
cosign sign --key private-key.pem myapp:v1.0

# 2. åœ¨Kubernetesä¸­éªŒè¯ç­¾å
apiVersion: v1
kind: Pod
metadata:
  name: signed-app
  annotations:
    # è¦æ±‚éªŒè¯é•œåƒç­¾å
    cosign.sigstore.dev/signature: "required"
spec:
  containers:
  - name: app
    image: myapp:v1.0@sha256:abc123...  # ä½¿ç”¨digestç¡®ä¿é•œåƒå®Œæ•´æ€§
```

**ğŸ” é•œåƒç­¾åç­–ç•¥**

```yaml
# ä½¿ç”¨OPA GatekeeperéªŒè¯é•œåƒç­¾å
apiVersion: templates.gatekeeper.sh/v1beta1
kind: ConstraintTemplate
metadata:
  name: requiredsignature
spec:
  crd:
    spec:
      names:
        kind: RequiredSignature
      validation:
        properties:
          trustedKeys:
            type: array
            items:
              type: string
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package requiredsignature
        
        violation[{"msg": msg}] {
          container := input.review.object.spec.containers[_]
          not is_signed(container.image)
          msg := sprintf("Image %v is not signed", [container.image])
        }
        
        is_signed(image) {
          # æ£€æŸ¥é•œåƒæ˜¯å¦æœ‰æœ‰æ•ˆç­¾åçš„é€»è¾‘
          true
        }

---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: RequiredSignature
metadata:
  name: must-be-signed
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
  parameters:
    trustedKeys:
      - "keyid:abc123"
      - "keyid:def456"
```

### 7.3 æ¼æ´æ‰«æ


**ğŸ” é•œåƒæ¼æ´æ‰«æå®è·µ**

```yaml
# 1. åœ¨CI/CDä¸­é›†æˆæ¼æ´æ‰«æ
# .github/workflows/security-scan.yml
name: Security Scan
on: [push, pull_request]

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    
    - name: Build Docker image
      run: docker build -t myapp:${{ github.sha }} .
    
    - name: Run Trivy vulnerability scanner
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: myapp:${{ github.sha }}
        format: 'sarif'
        output: 'trivy-results.sarif'
        
    - name: Upload Trivy scan results
      uses: github/codeql-action/upload-sarif@v1
      with:
        sarif_file: 'trivy-results.sarif'
    
    - name: Check scan results
      run: |
        # å¦‚æœå‘ç°é«˜å±æ¼æ´ï¼Œæ„å»ºå¤±è´¥
        trivy image --exit-code 1 --severity HIGH,CRITICAL myapp:${{ github.sha }}

---
# 2. Kubernetesä¸­çš„æ¼æ´æ‰«æç­–ç•¥
apiVersion: v1
kind: ConfigMap
metadata:
  name: security-policy
  namespace: kube-system
data:
  policy.yaml: |
    rules:
      - name: "high-severity-vulnerabilities"
        condition: "vulnerability.severity == 'HIGH' or vulnerability.severity == 'CRITICAL'"
        action: "reject"
        message: "Image contains high severity vulnerabilities"
      
      - name: "unscanned-images"
        condition: "not vulnerability.scanned"
        action: "reject"
        message: "Image has not been scanned for vulnerabilities"
```

### 7.4 å¯ä¿¡ä»“åº“é…ç½®


**ğŸª å¯ä¿¡é•œåƒä»“åº“ç­–ç•¥**

```yaml
# 1. é™åˆ¶é•œåƒæ¥æº
apiVersion: config.gatekeeper.sh/v1alpha1
kind: Config
metadata:
  name: config
  namespace: gatekeeper-system
spec:
  validation:
    traces:
      - user:
          kind:
            group: "*"
            version: "*"
            kind: "*"
          
# 2. åªå…è®¸ç‰¹å®šä»“åº“çš„é•œåƒ
apiVersion: templates.gatekeeper.sh/v1beta1
kind: ConstraintTemplate
metadata:
  name: allowedrepos
spec:
  crd:
    spec:
      names:
        kind: AllowedRepos
      validation:
        properties:
          repos:
            type: array
            items:
              type: string
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package allowedrepos
        
        violation[{"msg": msg}] {
          container := input.review.object.spec.containers[_]
          not starts_with_allowed_repo(container.image)
          msg := sprintf("Image %v is not from allowed repository", [container.image])
        }
        
        starts_with_allowed_repo(image) {
          allowed_repo := input.parameters.repos[_]
          startswith(image, allowed_repo)
        }

---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: AllowedRepos
metadata:
  name: repo-must-be-internal
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
  parameters:
    repos:
      - "harbor.company.com/"
      - "registry.company.com/"
      - "gcr.io/company-project/"
```

### 7.5 å¯†é’¥ç®¡ç†


**ğŸ—ï¸ Kubernetes SecretåŸºç¡€**

```yaml
# 1. åˆ›å»ºSecretçš„å‡ ç§æ–¹å¼

# æ–¹å¼1ï¼šå‘½ä»¤è¡Œåˆ›å»º
kubectl create secret generic my-secret \
  --from-literal=username=admin \
  --from-literal=password=secretpassword

# æ–¹å¼2ï¼šä»æ–‡ä»¶åˆ›å»º
kubectl create secret generic my-secret \
  --from-file=username.txt \
  --from-file=password.txt

# æ–¹å¼3ï¼šYAMLå®šä¹‰ï¼ˆéœ€è¦base64ç¼–ç ï¼‰
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
data:
  username: YWRtaW4=        # echo -n "admin" | base64
  password: c2VjcmV0cGFzc3dvcmQ=  # echo -n "secretpassword" | base64

# æ–¹å¼4ï¼šç›´æ¥ä½¿ç”¨æ˜æ–‡ï¼ˆKubernetes 1.14+ï¼‰
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
stringData:
  username: admin           # æ˜æ–‡ï¼ŒKubernetesè‡ªåŠ¨ç¼–ç 
  password: secretpassword
```

**ğŸ” åœ¨Podä¸­ä½¿ç”¨Secret**

```yaml
# 1. ç¯å¢ƒå˜é‡æ–¹å¼
apiVersion: v1
kind: Pod
metadata:
  name: secret-env-pod
spec:
  containers:
  - name: app
    image: nginx
    env:
    - name: USERNAME
      valueFrom:
        secretKeyRef:
          name: my-secret
          key: username
    - name: PASSWORD
      valueFrom:
        secretKeyRef:
          name: my-secret
          key: password

---
# 2. æ–‡ä»¶æŒ‚è½½æ–¹å¼ï¼ˆæ¨èï¼‰
apiVersion: v1
kind: Pod
metadata:
  name: secret-volume-pod
spec:
  containers:
  - name: app
    image: nginx
    volumeMounts:
    - name: secret-volume
      mountPath: "/etc/secrets"
      readOnly: true
    # Secretå†…å®¹ä¼šä»¥æ–‡ä»¶å½¢å¼å‡ºç°åœ¨/etc/secretsç›®å½•
    # /etc/secrets/username æ–‡ä»¶å†…å®¹æ˜¯admin
    # /etc/secrets/password æ–‡ä»¶å†…å®¹æ˜¯secretpassword
  volumes:
  - name: secret-volume
    secret:
      secretName: my-secret
```

### 7.6 å¤–éƒ¨å¯†é’¥åº“é›†æˆ


**ğŸ›ï¸ ä¸å¤–éƒ¨å¯†é’¥ç®¡ç†ç³»ç»Ÿé›†æˆ**

```yaml
# 1. ä½¿ç”¨External Secrets Operatoré›†æˆHashiCorp Vault
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
  namespace: production
spec:
  provider:
    vault:
      server: "https://vault.company.com"
      path: "secret"
      version: "v2"
      auth:
        kubernetes:
          mountPath: "kubernetes"
          role: "myapp"
          secretRef:
            name: vault-token
            key: token

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: app-secrets
  namespace: production
spec:
  refreshInterval: 1m        # æ¯åˆ†é’ŸåŒæ­¥ä¸€æ¬¡
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: app-secrets        # åœ¨K8sä¸­åˆ›å»ºçš„Secretåç§°
    creationPolicy: Owner
  data:
  - secretKey: database-password
    remoteRef:
      key: myapp/database
      property: password
  - secretKey: api-key
    remoteRef:
      key: myapp/external-api
      property: key

---
# 2. åœ¨åº”ç”¨ä¸­ä½¿ç”¨å¤–éƒ¨Secret
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
  namespace: production
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: app
        image: myapp:latest
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: database-password
        - name: API_KEY
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: api-key
```

### 7.7 CSIå¯†é’¥é©±åŠ¨é›†æˆ


**ğŸ’¾ ä½¿ç”¨CSI Secret Driver**

```yaml
# 1. å®‰è£…Secrets Store CSI Driver
apiVersion: v1
kind: ServiceAccount
metadata:
  name: secrets-store-csi-driver
  namespace: kube-system

---
# 2. é…ç½®SecretProviderClass
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: app-secrets
  namespace: production
spec:
  provider: azure                # ä½¿ç”¨Azure Key Vault
  parameters:
    usePodIdentity: "false"
    keyvaultName: "myapp-keyvault"
    tenantId: "12345-abcde-67890"
    objects: |
      array:
        - |
          objectName: database-password
          objectType: secret
        - |
          objectName: api-key
          objectType: secret
  secretObjects:                 # åŒæ­¥åˆ°K8s Secret
  - secretName: app-secrets
    type: Opaque
    data:
    - objectName: database-password
      key: db-password
    - objectName: api-key
      key: api-key

---
# 3. Podä½¿ç”¨CSIé©±åŠ¨æŒ‚è½½å¯†é’¥
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
  namespace: production
spec:
  serviceAccountName: myapp-sa
  containers:
  - name: app
    image: myapp:latest
    volumeMounts:
    - name: secrets-store
      mountPath: "/mnt/secrets"
      readOnly: true
    env:
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: app-secrets
          key: db-password
  volumes:
  - name: secrets-store
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: "app-secrets"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‘åŸç”Ÿè®¤è¯ï¼šå¤šå±‚æ¬¡ã€åŠ¨æ€åŒ–çš„å®‰å…¨ä½“ç³»ï¼Œè¦†ç›–ç”¨æˆ·ã€æœåŠ¡ã€ç½‘ç»œã€æ•°æ®
ğŸ”¸ RBACæƒé™ï¼šç”¨æˆ·+è§’è‰²+ç»‘å®šï¼Œå®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶
ğŸ”¸ ServiceAccountï¼šPodçš„èº«ä»½è¯ï¼Œè‡ªåŠ¨Tokenç®¡ç†å’Œè½®æ¢
ğŸ”¸ å‡†å…¥æ§åˆ¶ï¼šå››é“å…³å¡ç¡®ä¿å®‰å…¨ï¼Œè®¤è¯â†’æˆæƒâ†’å˜æ›´â†’éªŒè¯
ğŸ”¸ Istio mTLSï¼šæœåŠ¡é—´åŒå‘è®¤è¯ï¼Œé›¶ä¿¡ä»»ç½‘ç»œæ¶æ„
ğŸ”¸ ç½‘ç»œç­–ç•¥ï¼šPodçº§åˆ«é˜²ç«å¢™ï¼Œæ§åˆ¶å¾®æœåŠ¡é€šä¿¡
ğŸ”¸ å®¹å™¨å®‰å…¨ï¼šé•œåƒç­¾åã€æ¼æ´æ‰«æã€å¯ä¿¡ä»“åº“
ğŸ”¸ å¯†é’¥ç®¡ç†ï¼šSecretè‡ªåŠ¨åŒ–ï¼Œå¤–éƒ¨å¯†é’¥åº“é›†æˆ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ äº‘åŸç”Ÿå®‰å…¨çš„å±‚æ¬¡åŒ–é˜²æŠ¤**
```
ç”¨æˆ·å±‚ï¼šRBAC + OIDCè®¤è¯
æœåŠ¡å±‚ï¼šServiceAccount + mTLS
ç½‘ç»œå±‚ï¼šNetworkPolicy + Istio AuthZ
æ•°æ®å±‚ï¼šSecretç®¡ç† + åŠ å¯†å­˜å‚¨
é•œåƒå±‚ï¼šç­¾åéªŒè¯ + æ¼æ´æ‰«æ
è¿è¡Œæ—¶ï¼šå‡†å…¥æ§åˆ¶ + è¡Œä¸ºç›‘æ§
```

**ğŸ”¹ é›¶ä¿¡ä»»æ¶æ„ç†å¿µ**
```
ä¼ ç»Ÿä¿¡ä»»æ¨¡å¼ï¼šå†…ç½‘=å®‰å…¨ï¼Œå¤–ç½‘=å±é™©
é›¶ä¿¡ä»»æ¨¡å¼ï¼šä»»ä½•é€šä¿¡éƒ½è¦éªŒè¯èº«ä»½å’Œæƒé™
å®ç°æ–¹å¼ï¼šmTLS + RBAC + ç½‘ç»œç­–ç•¥ + æŒç»­ç›‘æ§
```

**ğŸ”¹ è‡ªåŠ¨åŒ–å®‰å…¨ç®¡ç†**
```
è¯ä¹¦ç®¡ç†ï¼šè‡ªåŠ¨é¢å‘ã€è½®æ¢ã€åŠé”€
å¯†é’¥è½®æ¢ï¼šå®šæœŸæ›´æ–°ï¼Œæ— åœæœºåˆ‡æ¢
æ¼æ´æ£€æµ‹ï¼šCI/CDé›†æˆï¼Œå®æ—¶æ‰«æ
ç­–ç•¥æ‰§è¡Œï¼šå‡†å…¥æ§åˆ¶ï¼Œè‡ªåŠ¨æ‹¦æˆª
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¼ä¸šçº§å®‰å…¨åœºæ™¯**
- **å¤šç§Ÿæˆ·éš”ç¦»**ï¼šä¸åŒå›¢é˜Ÿ/é¡¹ç›®å®‰å…¨éš”ç¦»
- **åˆè§„å®¡è®¡**ï¼šæ»¡è¶³SOC2ã€ISO27001ç­‰æ ‡å‡†
- **é›¶åœæœºå‡çº§**ï¼šå®‰å…¨ç­–ç•¥åŠ¨æ€æ›´æ–°
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šå‡å°‘äººå·¥å®‰å…¨é…ç½®é”™è¯¯

**ğŸ› ï¸ DevSecOpsé›†æˆ**
- **å®‰å…¨å·¦ç§»**ï¼šå¼€å‘é˜¶æ®µé›†æˆå®‰å…¨æ£€æŸ¥
- **æŒç»­åˆè§„**ï¼šè‡ªåŠ¨åŒ–å®‰å…¨ç­–ç•¥æ‰§è¡Œ
- **å¿«é€Ÿå“åº”**ï¼šå®‰å…¨äº‹ä»¶è‡ªåŠ¨å¤„ç†
- **å…¨é“¾è·¯ç›‘æ§**ï¼šä»ä»£ç åˆ°è¿è¡Œæ—¶çš„å®‰å…¨å¯è§†åŒ–

### 8.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ“ˆ æŠ€æœ¯æ·±å…¥æ–¹å‘**
```
åŸºç¡€å®‰å…¨ â†’ æœåŠ¡ç½‘æ ¼ â†’ é›¶ä¿¡ä»»æ¶æ„ â†’ è‡ªåŠ¨åŒ–SecOps
   â†“           â†“           â†“              â†“
RBACé…ç½®   Istioéƒ¨ç½²   ç­–ç•¥ç¼–æ’      ç›‘æ§å‘Šè­¦
è¯ä¹¦ç®¡ç†   mTLSé…ç½®    é£é™©è¯„ä¼°      è‡ªåŠ¨å“åº”
```

**ğŸ› ï¸ å®æˆ˜æŠ€èƒ½å»ºè®®**
- **å·¥å…·æŒæ¡**ï¼škubectlã€istioctlã€cosignã€trivy
- **ç­–ç•¥ç¼–å†™**ï¼šYAMLé…ç½®ã€OPA Regoè¯­è¨€
- **ç›‘æ§è¯Šæ–­**ï¼šæ—¥å¿—åˆ†æã€æ€§èƒ½ç›‘æ§ã€å®‰å…¨äº‹ä»¶å“åº”
- **è‡ªåŠ¨åŒ–**ï¼šCI/CDé›†æˆã€GitOpsã€Policy as Code

### 8.5 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**âš ï¸ æ–°æ‰‹å¸¸è§é”™è¯¯**
```
æƒé™è¿‡åº¦å¼€æ”¾ â†’ æœ€å°æƒé™åŸåˆ™
è¯ä¹¦ç®¡ç†æ··ä¹± â†’ è‡ªåŠ¨åŒ–è¯ä¹¦ç”Ÿå‘½å‘¨æœŸ
ç½‘ç»œç­–ç•¥ç¼ºå¤± â†’ é»˜è®¤æ‹’ç»+ç™½åå•
å¯†é’¥ç¡¬ç¼–ç  â†’ å¤–éƒ¨å¯†é’¥ç®¡ç†ç³»ç»Ÿ
é•œåƒæ¥æºä¸å¯ä¿¡ â†’ å¯ä¿¡ä»“åº“+ç­¾åéªŒè¯
```

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**
```
åˆ†å±‚é˜²æŠ¤ï¼šä¸ä¾èµ–å•ä¸€å®‰å…¨æªæ–½
è‡ªåŠ¨åŒ–ä¼˜å…ˆï¼šå‡å°‘äººå·¥æ“ä½œé”™è¯¯
æŒç»­ç›‘æ§ï¼šå®æ—¶å®‰å…¨çŠ¶æ€æ£€æŸ¥
å®šæœŸæ¼”ç»ƒï¼šå®‰å…¨äº‹ä»¶å“åº”æµç¨‹
æ–‡æ¡£åŒ–ï¼šå®‰å…¨ç­–ç•¥å’Œæ“ä½œæ‰‹å†Œ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
äº‘åŸç”Ÿå®‰å…¨åˆ†å±‚çº§ï¼ŒRBACæƒé™è¦ç»†è‡´
ServiceAccountèº«ä»½æ˜ï¼Œå‡†å…¥æ§åˆ¶å››é“å…³
Istioç½‘æ ¼é›¶ä¿¡ä»»ï¼ŒmTLSåŠ å¯†ä¿å®‰å…¨
ç½‘ç»œç­–ç•¥åšé˜²ç«å¢™ï¼Œå¯†é’¥ç®¡ç†è¦è‡ªåŠ¨åŒ–
é•œåƒæ‰«æé˜²æ¼æ´ï¼Œå¯ä¿¡ä»“åº“æ˜¯åŸºç¡€
```