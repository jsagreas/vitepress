---
title: 3ã€APIå®‰å…¨è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [Tokenå­˜å‚¨ä¸ä¼ è¾“æœºåˆ¶](#1-Tokenå­˜å‚¨ä¸ä¼ è¾“æœºåˆ¶)
2. [ä¼ è¾“æ–¹å¼è¯¦è§£](#2-ä¼ è¾“æ–¹å¼è¯¦è§£)
3. [Tokenæœ‰æ•ˆæœŸç®¡ç†](#3-Tokenæœ‰æ•ˆæœŸç®¡ç†)
4. [Tokenæ’¤é”€ä¸é»‘åå•æœºåˆ¶](#4-Tokenæ’¤é”€ä¸é»‘åå•æœºåˆ¶)
5. [è‡ªå®šä¹‰Tokenè®¤è¯ç³»ç»Ÿå®æˆ˜](#5-è‡ªå®šä¹‰Tokenè®¤è¯ç³»ç»Ÿå®æˆ˜)
6. [æ¥å£æƒé™è®¾è®¡](#6-æ¥å£æƒé™è®¾è®¡)
7. [RESTful APIå®‰å…¨è®¾è®¡](#7-RESTful-APIå®‰å…¨è®¾è®¡)
8. [æ¥å£é™æµä¸ç†”æ–­](#8-æ¥å£é™æµä¸ç†”æ–­)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Tokenå­˜å‚¨ä¸ä¼ è¾“æœºåˆ¶


### 1.1 Tokenæ˜¯ä»€ä¹ˆ


**ğŸ¯ é€šä¿—è§£é‡Š**
Tokenå°±åƒæ˜¯ä¸€å¼ "é€šè¡Œè¯"ï¼Œä½ ç™»å½•æˆåŠŸåï¼Œç³»ç»Ÿç»™ä½ ä¸€å¼ é€šè¡Œè¯ï¼Œåç»­è®¿é—®å…¶ä»–é¡µé¢æ—¶å‡ºç¤ºè¿™å¼ é€šè¡Œè¯å°±è¡Œäº†ï¼Œä¸ç”¨æ¯æ¬¡éƒ½è¾“å…¥ç”¨æˆ·åå¯†ç ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
æ¸¸ä¹å›­é—¨ç¥¨ = Token
- ä¹°ç¥¨(ç™»å½•) â†’ å¾—åˆ°é—¨ç¥¨(Token)  
- ç©é¡¹ç›®æ—¶å‡ºç¤ºé—¨ç¥¨(æºå¸¦Token)
- é—¨ç¥¨è¿‡æœŸéœ€è¦é‡æ–°ä¹°ç¥¨(Tokenè¿‡æœŸéœ€é‡æ–°ç™»å½•)
```

### 1.2 Tokençš„ä¸¤ç§ä¸»è¦å­˜å‚¨ä½ç½®


#### ğŸ“± å®¢æˆ·ç«¯å­˜å‚¨ä½ç½®å¯¹æ¯”


| å­˜å‚¨ä½ç½® | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| ğŸª **Cookie** | `è‡ªåŠ¨æºå¸¦ï¼Œæ“ä½œç®€å•` | `å®¹æ˜“CSRFæ”»å‡»ï¼Œå¤§å°é™åˆ¶4KB` | `ä¼ ç»Ÿç½‘ç«™ï¼Œéœ€è¦è‡ªåŠ¨ç™»å½•` |
| ğŸ’¾ **LocalStorage** | `å®¹é‡å¤§ï¼Œä¸ä¼šè‡ªåŠ¨å‘é€` | `XSSæ”»å‡»é£é™©ï¼Œæ— æ³•è·¨åŸŸ` | `SPAå•é¡µåº”ç”¨ï¼Œéœ€è¦æŒä¹…åŒ–` |
| ğŸ§  **SessionStorage** | `é¡µé¢å…³é—­è‡ªåŠ¨æ¸…é™¤` | `åˆ·æ–°é¡µé¢ä¼šä¸¢å¤±` | `ä¸´æ—¶ä¼šè¯ï¼Œå®‰å…¨è¦æ±‚é«˜` |
| ğŸ“ **Memory** | `æœ€å®‰å…¨ï¼Œå†…å­˜å­˜å‚¨` | `é¡µé¢åˆ·æ–°ä¸¢å¤±` | `é«˜å®‰å…¨è¦æ±‚åœºæ™¯` |

#### ğŸ”’ Headerä¼ è¾“æ–¹å¼è¯¦è§£


```
å®¢æˆ·ç«¯è¯·æ±‚ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/user HTTP/1.1      â”‚
â”‚ Host: api.example.com       â”‚
â”‚ Authorization: Bearer abc123â”‚ â† Tokenæ”¾åœ¨è¿™é‡Œ
â”‚ Content-Type: application/json â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ ä¸ºä»€ä¹ˆæ¨èHeaderä¼ è¾“ï¼Ÿ**
```
âœ… å®‰å…¨æ€§é«˜ï¼šä¸ä¼šå‡ºç°åœ¨URLä¸­è¢«æ—¥å¿—è®°å½•
âœ… çµæ´»æ€§å¥½ï¼šå¯ä»¥æºå¸¦æ›´å¤šè®¤è¯ä¿¡æ¯
âœ… æ ‡å‡†åŒ–ï¼šéµå¾ªHTTPæ ‡å‡†è§„èŒƒ
âœ… é˜²CSRFï¼šä¸ä¼šè¢«æµè§ˆå™¨è‡ªåŠ¨æºå¸¦
```

---

## 2. ğŸ“¡ ä¼ è¾“æ–¹å¼è¯¦è§£


### 2.1 ä¸‰ç§ä¸»è¦ä¼ è¾“æ–¹å¼


#### ğŸ¯ æ–¹å¼1ï¼šHeaderä¼ è¾“ï¼ˆæ¨èï¼‰


```javascript
// å‰ç«¯å‘é€è¯·æ±‚
axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;

// æˆ–è€…å•ç‹¬è®¾ç½®
axios.get('/api/user', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

```java
// åç«¯è§£æHeader
@RestController
public class UserController {
    
    @GetMapping("/api/user")
    public User getUser(@RequestHeader("Authorization") String authHeader) {
        // æå–Tokenï¼šBearer abc123 â†’ abc123  
        String token = authHeader.replace("Bearer ", "");
        // éªŒè¯Token...
        return userService.getUser(token);
    }
}
```

#### ğŸ¯ æ–¹å¼2ï¼šQueryå‚æ•°ä¼ è¾“ï¼ˆä¸æ¨èï¼‰


```javascript
// å‰ç«¯è¯·æ±‚
axios.get(`/api/user?token=${token}`);
```

**âš ï¸ ä¸ºä»€ä¹ˆä¸æ¨èï¼Ÿ**
```
âŒ URLä¼šè¢«è®°å½•åœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­
âŒ æµè§ˆå™¨å†å²è®°å½•ä¼šä¿å­˜Token
âŒ å¯èƒ½åœ¨ç½‘ç»œä»£ç†ä¸­è¢«ç¼“å­˜
âŒ GETè¯·æ±‚URLé•¿åº¦æœ‰é™åˆ¶
```

#### ğŸ¯ æ–¹å¼3ï¼šBodyä¼ è¾“ï¼ˆPOSTè¯·æ±‚ï¼‰


```javascript
// å‰ç«¯è¯·æ±‚
axios.post('/api/user', {
  token: token,
  // å…¶ä»–ä¸šåŠ¡æ•°æ®
});
```

```java
// åç«¯æ¥æ”¶
@PostMapping("/api/user")
public User getUser(@RequestBody UserRequest request) {
    String token = request.getToken();
    // éªŒè¯Token...
}
```

### 2.2 ä¼ è¾“å®‰å…¨å¢å¼º


#### ğŸ”’ HTTPSå¿…è¦æ€§


```
HTTPä¼ è¾“ï¼ˆä¸å®‰å…¨ï¼‰:
å®¢æˆ·ç«¯ ----[Tokenæ˜æ–‡ä¼ è¾“]----> æœåŠ¡å™¨
           â†‘ 
       å¯èƒ½è¢«çªƒå¬

HTTPSä¼ è¾“ï¼ˆå®‰å…¨ï¼‰:
å®¢æˆ·ç«¯ ----[TokenåŠ å¯†ä¼ è¾“]----> æœåŠ¡å™¨
           â†‘
       SSL/TLSåŠ å¯†ä¿æŠ¤
```

**ğŸ’¡ å®‰å…¨ä¼ è¾“æ£€æŸ¥æ¸…å•**
- [x] ä½¿ç”¨HTTPSåè®®
- [x] Tokenæ”¾åœ¨Authorization Headerä¸­
- [x] é¿å…åœ¨URLä¸­ä¼ è¾“Token
- [x] è®¾ç½®åˆé€‚çš„CORSç­–ç•¥

---

## 3. â° Tokenæœ‰æ•ˆæœŸç®¡ç†


### 3.1 æœ‰æ•ˆæœŸè®¾ç½®ç­–ç•¥


**ğŸ¯ ä¸åŒåœºæ™¯çš„æœ‰æ•ˆæœŸè®¾ç½®**

```
å®‰å…¨çº§åˆ«å¯¹æ¯”ï¼š
é«˜å®‰å…¨(é“¶è¡Œ)ï¼š15åˆ†é’Ÿ-2å°æ—¶
ä¸­ç­‰å®‰å…¨(ç”µå•†)ï¼š1-24å°æ—¶  
ä½å®‰å…¨(å†…å®¹ç«™)ï¼š7-30å¤©

æ´»è·ƒåº¦è€ƒè™‘ï¼š
é«˜é¢‘ä½¿ç”¨ï¼šè¾ƒé•¿æœ‰æ•ˆæœŸ + è‡ªåŠ¨ç»­æœŸ
ä½é¢‘ä½¿ç”¨ï¼šè¾ƒçŸ­æœ‰æ•ˆæœŸ + æ‰‹åŠ¨åˆ·æ–°
```

### 3.2 Tokenç»­æœŸæœºåˆ¶


#### ğŸ”„ è‡ªåŠ¨ç»­æœŸå®ç°


```javascript
// å‰ç«¯è‡ªåŠ¨ç»­æœŸæ‹¦æˆªå™¨
axios.interceptors.response.use(
  response => response,
  error => {
    // Tokenå³å°†è¿‡æœŸï¼ˆçŠ¶æ€ç 401ï¼‰
    if (error.response.status === 401) {
      return refreshToken().then(newToken => {
        // æ›´æ–°Token
        localStorage.setItem('token', newToken);
        // é‡è¯•åŸè¯·æ±‚
        error.config.headers['Authorization'] = `Bearer ${newToken}`;
        return axios.request(error.config);
      });
    }
    return Promise.reject(error);
  }
);
```

```java
// åç«¯Tokenç»­æœŸæ¥å£
@PostMapping("/auth/refresh")
public TokenResponse refreshToken(@RequestHeader("Refresh-Token") String refreshToken) {
    // éªŒè¯åˆ·æ–°Token
    if (tokenService.isValidRefreshToken(refreshToken)) {
        // ç”Ÿæˆæ–°çš„è®¿é—®Token
        String newAccessToken = tokenService.generateAccessToken(userId);
        return new TokenResponse(newAccessToken);
    }
    throw new UnauthorizedException("Invalid refresh token");
}
```

#### ğŸ“Š åŒTokenæœºåˆ¶


```
Tokenç»“æ„è®¾è®¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Access Token (è®¿é—®ä»¤ç‰Œ)        â”‚
â”‚ â”œâ”€ æœ‰æ•ˆæœŸï¼š30åˆ†é’Ÿ              â”‚  
â”‚ â”œâ”€ ç”¨é€”ï¼šAPIè®¿é—®              â”‚
â”‚ â””â”€ ç‰¹ç‚¹ï¼šé¢‘ç¹ä½¿ç”¨ï¼ŒçŸ­æœŸæœ‰æ•ˆ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Refresh Token (åˆ·æ–°ä»¤ç‰Œ)       â”‚
â”‚ â”œâ”€ æœ‰æ•ˆæœŸï¼š7å¤©                â”‚
â”‚ â”œâ”€ ç”¨é€”ï¼šåˆ·æ–°Access Token     â”‚  
â”‚ â””â”€ ç‰¹ç‚¹ï¼šä¸å¸¸ä½¿ç”¨ï¼Œé•¿æœŸæœ‰æ•ˆ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 æœ‰æ•ˆæœŸéªŒè¯æµç¨‹


```
TokenéªŒè¯æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚
    â†“
æå–Token
    â†“
Tokenå­˜åœ¨ï¼Ÿ â”€â”€Noâ”€â”€â†’ è¿”å›401æœªè®¤è¯
    â†“ Yes
Tokenè¿‡æœŸï¼Ÿ â”€â”€Yesâ”€â”€â†’ å°è¯•è‡ªåŠ¨ç»­æœŸ
    â†“ No                â†“
éªŒè¯Tokenç­¾å â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç»­æœŸæˆåŠŸï¼Ÿ
    â†“                   â†“ No
ç­¾åæœ‰æ•ˆï¼Ÿ â”€â”€Noâ”€â”€â†’ è¿”å›401æ— æ•ˆToken  
    â†“ Yes               â†“
ç»§ç»­å¤„ç†è¯·æ±‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¿”å›ç™»å½•é¡µé¢
```

---

## 4. ğŸš« Tokenæ’¤é”€ä¸é»‘åå•æœºåˆ¶


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦Tokenæ’¤é”€


**ğŸ¯ å¸¸è§æ’¤é”€åœºæ™¯**
```
ç”¨æˆ·ä¸»åŠ¨ç™»å‡ºï¼šç”¨æˆ·ç‚¹å‡»é€€å‡ºç™»å½•
å¯†ç ä¿®æ”¹ï¼šä¿®æ”¹å¯†ç åæ—§Tokenå¤±æ•ˆ
è´¦æˆ·é”å®šï¼šç®¡ç†å‘˜é”å®šç”¨æˆ·è´¦æˆ·  
è®¾å¤‡ä¸¢å¤±ï¼šæ‰‹æœºä¸¢å¤±éœ€è¦è¿œç¨‹ç™»å‡º
å®‰å…¨å¨èƒï¼šå‘ç°Tokenæ³„éœ²é£é™©
```

### 4.2 é»‘åå•æœºåˆ¶å®ç°


#### ğŸ—ƒï¸ æ•°æ®åº“é»‘åå•


```sql
-- Tokené»‘åå•è¡¨è®¾è®¡
CREATE TABLE token_blacklist (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    token_id VARCHAR(255) NOT NULL,      -- Tokenå”¯ä¸€æ ‡è¯†
    user_id BIGINT NOT NULL,             -- ç”¨æˆ·ID
    revoked_at TIMESTAMP DEFAULT NOW(),  -- æ’¤é”€æ—¶é—´
    reason VARCHAR(100),                 -- æ’¤é”€åŸå› 
    expires_at TIMESTAMP NOT NULL,       -- TokenåŸå§‹è¿‡æœŸæ—¶é—´
    INDEX idx_token_id (token_id),
    INDEX idx_user_id (user_id)
);
```

```java
// é»‘åå•æœåŠ¡å®ç°
@Service
public class TokenBlacklistService {
    
    // æ·»åŠ Tokenåˆ°é»‘åå•
    public void revokeToken(String tokenId, Long userId, String reason) {
        TokenBlacklist blacklist = new TokenBlacklist();
        blacklist.setTokenId(tokenId);
        blacklist.setUserId(userId);
        blacklist.setReason(reason);
        blacklist.setExpiresAt(getTokenExpireTime(tokenId));
        
        blacklistRepository.save(blacklist);
        
        // åŒæ­¥åˆ°Redisç¼“å­˜
        redisTemplate.setex("blacklist:" + tokenId, 
                          getTokenTTL(tokenId), "revoked");
    }
    
    // æ£€æŸ¥Tokenæ˜¯å¦åœ¨é»‘åå•ä¸­
    public boolean isTokenRevoked(String tokenId) {
        // å…ˆæŸ¥Redisç¼“å­˜
        if (redisTemplate.exists("blacklist:" + tokenId)) {
            return true;
        }
        
        // å†æŸ¥æ•°æ®åº“
        return blacklistRepository.existsByTokenId(tokenId);
    }
}
```

#### âš¡ Redisç¼“å­˜é»‘åå•


```java
// Redisé»‘åå•æ“ä½œ
@Component  
public class RedisBlacklistManager {
    
    // æ·»åŠ åˆ°é»‘åå•
    public void addToBlacklist(String tokenId, long ttlSeconds) {
        redisTemplate.setex("blacklist:" + tokenId, ttlSeconds, "revoked");
    }
    
    // æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•
    public boolean isBlacklisted(String tokenId) {
        return redisTemplate.exists("blacklist:" + tokenId);
    }
    
    // æ‰¹é‡æ’¤é”€ç”¨æˆ·æ‰€æœ‰Token
    public void revokeAllUserTokens(Long userId) {
        String pattern = "user_tokens:" + userId + ":*";
        Set<String> keys = redisTemplate.keys(pattern);
        
        for (String key : keys) {
            String tokenId = extractTokenId(key);
            addToBlacklist(tokenId, getTokenTTL(tokenId));
        }
    }
}
```

### 4.3 æ’¤é”€æœºåˆ¶å¯¹æ¯”


| æ–¹æ¡ˆ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| ğŸ—„ï¸ **æ•°æ®åº“é»‘åå•** | `æŒä¹…åŒ–å­˜å‚¨ï¼Œæ•°æ®å®‰å…¨` | `æŸ¥è¯¢æ€§èƒ½è¾ƒæ…¢` | `Tokenæ•°é‡ä¸å¤§ï¼ŒæŒä¹…åŒ–è¦æ±‚é«˜` |
| âš¡ **Redisé»‘åå•** | `æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œæ€§èƒ½å¥½` | `é‡å¯ä¼šä¸¢å¤±ï¼Œéœ€è¦æŒä¹…åŒ–` | `é«˜å¹¶å‘åœºæ™¯ï¼ŒTokenæ•°é‡å¤§` |
| ğŸ’¾ **æ··åˆæ–¹æ¡ˆ** | `å…¼é¡¾æ€§èƒ½å’Œå¯é æ€§` | `å®ç°å¤æ‚ï¼Œç»´æŠ¤æˆæœ¬é«˜` | `ç”Ÿäº§ç¯å¢ƒæ¨èæ–¹æ¡ˆ` |

---

## 5. âš’ï¸ è‡ªå®šä¹‰Tokenè®¤è¯ç³»ç»Ÿå®æˆ˜


### 5.1 Tokenç”Ÿæˆå™¨å®ç°


```java
// Tokenç”Ÿæˆå’ŒéªŒè¯å·¥å…·ç±»
@Component
public class CustomTokenGenerator {
    
    private static final String SECRET_KEY = "your-secret-key";
    private static final long ACCESS_TOKEN_EXPIRY = 30 * 60 * 1000; // 30åˆ†é’Ÿ
    
    // ç”Ÿæˆè®¿é—®Token
    public String generateAccessToken(Long userId, String username) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("userId", userId);
        claims.put("username", username);
        claims.put("type", "access");
        
        return Jwts.builder()
            .setClaims(claims)
            .setSubject(username)
            .setIssuedAt(new Date())
            .setExpiration(new Date(System.currentTimeMillis() + ACCESS_TOKEN_EXPIRY))
            .signWith(SignatureAlgorithm.HS512, SECRET_KEY)
            .compact();
    }
    
    // éªŒè¯Token
    public Claims validateToken(String token) {
        try {
            return Jwts.parser()
                .setSigningKey(SECRET_KEY)
                .parseClaimsJws(token)
                .getBody();
        } catch (ExpiredJwtException e) {
            throw new TokenExpiredException("Tokenå·²è¿‡æœŸ");
        } catch (JwtException e) {
            throw new InvalidTokenException("Tokenæ— æ•ˆ");
        }
    }
    
    // ä»Tokenæå–ç”¨æˆ·ä¿¡æ¯
    public UserInfo extractUserInfo(String token) {
        Claims claims = validateToken(token);
        return UserInfo.builder()
            .userId(claims.get("userId", Long.class))
            .username(claims.getSubject())
            .build();
    }
}
```

### 5.2 è®¤è¯æ‹¦æˆªå™¨å®ç°


```java
// Tokenè®¤è¯æ‹¦æˆªå™¨
@Component
public class TokenAuthInterceptor implements HandlerInterceptor {
    
    @Autowired
    private CustomTokenGenerator tokenGenerator;
    
    @Autowired  
    private TokenBlacklistService blacklistService;
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) throws Exception {
        
        // è·å–Token
        String authHeader = request.getHeader("Authorization");
        if (authHeader == null || !authHeader.startsWith("Bearer ")) {
            response.setStatus(401);
            return false;
        }
        
        String token = authHeader.substring(7);
        
        try {
            // æ£€æŸ¥é»‘åå•
            if (blacklistService.isTokenRevoked(token)) {
                response.setStatus(401);
                return false;
            }
            
            // éªŒè¯Token
            UserInfo userInfo = tokenGenerator.extractUserInfo(token);
            
            // å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°è¯·æ±‚ä¸­
            request.setAttribute("currentUser", userInfo);
            
            return true;
            
        } catch (Exception e) {
            response.setStatus(401);
            return false;
        }
    }
}
```

### 5.3 ç™»å½•ç™»å‡ºæ¥å£


```java
// è®¤è¯æ§åˆ¶å™¨
@RestController
@RequestMapping("/auth")
public class AuthController {
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private CustomTokenGenerator tokenGenerator;
    
    @Autowired
    private TokenBlacklistService blacklistService;
    
    // ç”¨æˆ·ç™»å½•
    @PostMapping("/login")
    public LoginResponse login(@RequestBody LoginRequest request) {
        // éªŒè¯ç”¨æˆ·åå¯†ç 
        User user = userService.authenticate(request.getUsername(), 
                                           request.getPassword());
        
        if (user == null) {
            throw new BadCredentialsException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }
        
        // ç”ŸæˆToken
        String accessToken = tokenGenerator.generateAccessToken(
            user.getId(), user.getUsername());
        
        return LoginResponse.builder()
            .accessToken(accessToken)
            .tokenType("Bearer")
            .expiresIn(30 * 60) // 30åˆ†é’Ÿ
            .user(UserDTO.fromUser(user))
            .build();
    }
    
    // ç”¨æˆ·ç™»å‡º
    @PostMapping("/logout")
    public void logout(HttpServletRequest request) {
        String authHeader = request.getHeader("Authorization");
        String token = authHeader.substring(7);
        
        // å°†TokenåŠ å…¥é»‘åå•
        blacklistService.revokeToken(
            extractTokenId(token),
            getCurrentUserId(request),
            "ç”¨æˆ·ä¸»åŠ¨ç™»å‡º"
        );
    }
}
```

### 5.4 ä½¿ç”¨ç¤ºä¾‹


```javascript
// å‰ç«¯ç™»å½•ç¤ºä¾‹
async function login(username, password) {
    try {
        const response = await axios.post('/auth/login', {
            username,
            password
        });
        
        const { accessToken } = response.data;
        
        // å­˜å‚¨Token
        localStorage.setItem('token', accessToken);
        
        // è®¾ç½®é»˜è®¤è¯·æ±‚å¤´
        axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;
        
        console.log('ç™»å½•æˆåŠŸ');
    } catch (error) {
        console.error('ç™»å½•å¤±è´¥:', error.response.data.message);
    }
}

// å‰ç«¯ç™»å‡ºç¤ºä¾‹
async function logout() {
    try {
        await axios.post('/auth/logout');
        
        // æ¸…é™¤æœ¬åœ°Token
        localStorage.removeItem('token');
        delete axios.defaults.headers.common['Authorization'];
        
        // è·³è½¬åˆ°ç™»å½•é¡µ
        window.location.href = '/login';
    } catch (error) {
        console.error('ç™»å‡ºå¤±è´¥:', error);
    }
}
```

---

## 6. ğŸ”‘ æ¥å£æƒé™è®¾è®¡


### 6.1 æƒé™è®¾è®¡æ¦‚å¿µ


**ğŸ¯ æƒé™æ§åˆ¶ä¸‰è¦ç´ **
```
è®¤è¯(Authentication)ï¼šä½ æ˜¯è°ï¼Ÿ
â”œâ”€ ç”¨æˆ·èº«ä»½éªŒè¯
â”œâ”€ Tokenæœ‰æ•ˆæ€§æ£€æŸ¥  
â””â”€ ç”¨æˆ·çŠ¶æ€ç¡®è®¤

æˆæƒ(Authorization)ï¼šä½ èƒ½åšä»€ä¹ˆï¼Ÿ
â”œâ”€ è§’è‰²æƒé™åˆ¤æ–­
â”œâ”€ èµ„æºè®¿é—®æ§åˆ¶
â””â”€ æ“ä½œæƒé™éªŒè¯

å®¡è®¡(Audit)ï¼šä½ åšäº†ä»€ä¹ˆï¼Ÿ
â”œâ”€ æ“ä½œæ—¥å¿—è®°å½•
â”œâ”€ å¼‚å¸¸è¡Œä¸ºç›‘æ§
â””â”€ åˆè§„æ€§æ£€æŸ¥
```

### 6.2 æƒé™æ¨¡å‹è®¾è®¡


#### ğŸ—ï¸ RBACæƒé™æ¨¡å‹


```
æƒé™æ¨¡å‹ç»“æ„ï¼š
ç”¨æˆ·(User) â†â†’ è§’è‰²(Role) â†â†’ æƒé™(Permission) â†â†’ èµ„æº(Resource)
     â†“              â†“              â†“              â†“
   å¼ ä¸‰            ç®¡ç†å‘˜          ç”¨æˆ·ç®¡ç†         /api/users
   æå››            ç¼–è¾‘è€…          æ–‡ç« ç¼–è¾‘         /api/articles
```

```sql
-- æƒé™è¡¨è®¾è®¡
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY,
    username VARCHAR(50) UNIQUE,
    password VARCHAR(255),
    status TINYINT DEFAULT 1  -- 1:æ­£å¸¸ 0:ç¦ç”¨
);

-- è§’è‰²è¡¨  
CREATE TABLE roles (
    id BIGINT PRIMARY KEY,
    name VARCHAR(50) UNIQUE,   -- admin, editor, viewer
    description VARCHAR(255),
    status TINYINT DEFAULT 1
);

-- æƒé™è¡¨
CREATE TABLE permissions (
    id BIGINT PRIMARY KEY,
    name VARCHAR(50),          -- user:read, user:write  
    resource VARCHAR(100),     -- /api/users/*
    action VARCHAR(20)         -- GET, POST, PUT, DELETE
);

-- ç”¨æˆ·è§’è‰²å…³è”è¡¨
CREATE TABLE user_roles (
    user_id BIGINT,
    role_id BIGINT,
    PRIMARY KEY (user_id, role_id)
);

-- è§’è‰²æƒé™å…³è”è¡¨  
CREATE TABLE role_permissions (
    role_id BIGINT,
    permission_id BIGINT,
    PRIMARY KEY (role_id, permission_id)
);
```

### 6.3 æƒé™æ³¨è§£å®ç°


```java
// æƒé™æ£€æŸ¥æ³¨è§£
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
public @interface RequirePermission {
    String[] value();           // éœ€è¦çš„æƒé™
    String resource() default "";// èµ„æºè·¯å¾„
    LogicalOperator operator() default LogicalOperator.AND; // AND/OR
}

// æƒé™æ£€æŸ¥æ‹¦æˆªå™¨
@Component
public class PermissionInterceptor implements HandlerInterceptor {
    
    @Autowired
    private PermissionService permissionService;
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) throws Exception {
        
        // è·å–æ–¹æ³•ä¸Šçš„æƒé™æ³¨è§£
        RequirePermission annotation = getPermissionAnnotation(handler);
        if (annotation == null) {
            return true; // æ— æƒé™è¦æ±‚ï¼Œç›´æ¥é€šè¿‡
        }
        
        // è·å–å½“å‰ç”¨æˆ·
        UserInfo currentUser = getCurrentUser(request);
        if (currentUser == null) {
            response.setStatus(401);
            return false;
        }
        
        // æ£€æŸ¥æƒé™
        boolean hasPermission = permissionService.checkPermission(
            currentUser.getUserId(),
            annotation.value(),
            annotation.resource(),
            request.getMethod()
        );
        
        if (!hasPermission) {
            response.setStatus(403); // æƒé™ä¸è¶³
            return false;
        }
        
        return true;
    }
}
```

### 6.4 æƒé™ä½¿ç”¨ç¤ºä¾‹


```java
// ç”¨æˆ·ç®¡ç†æ¥å£
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    // æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ - éœ€è¦è¯»å–æƒé™
    @GetMapping
    @RequirePermission({"user:read"})
    public List<User> getUsers() {
        return userService.getAllUsers();
    }
    
    // åˆ›å»ºç”¨æˆ· - éœ€è¦å†™å…¥æƒé™
    @PostMapping
    @RequirePermission({"user:write"})  
    public User createUser(@RequestBody CreateUserRequest request) {
        return userService.createUser(request);
    }
    
    // åˆ é™¤ç”¨æˆ· - éœ€è¦åˆ é™¤æƒé™
    @DeleteMapping("/{id}")
    @RequirePermission({"user:delete"})
    public void deleteUser(@PathVariable Long id) {
        userService.deleteUser(id);
    }
    
    // ç®¡ç†å‘˜åŠŸèƒ½ - éœ€è¦ç®¡ç†å‘˜æƒé™
    @PostMapping("/admin/reset-password")
    @RequirePermission({"admin:user:manage"})
    public void resetPassword(@RequestBody ResetPasswordRequest request) {
        userService.adminResetPassword(request);
    }
}
```

### 6.5 åŠ¨æ€æƒé™æ£€æŸ¥


```java
// æƒé™æœåŠ¡å®ç°
@Service
public class PermissionService {
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŒ‡å®šæƒé™
    public boolean checkPermission(Long userId, String[] permissions, 
                                 String resource, String method) {
        // 1. è·å–ç”¨æˆ·æ‰€æœ‰æƒé™
        List<String> userPermissions = getUserPermissions(userId);
        
        // 2. æ£€æŸ¥æ˜¯å¦åŒ…å«æ‰€éœ€æƒé™
        for (String permission : permissions) {
            if (!userPermissions.contains(permission)) {
                return false;
            }
        }
        
        // 3. æ£€æŸ¥èµ„æºå’Œæ–¹æ³•æƒé™
        return checkResourcePermission(userId, resource, method);
    }
    
    // è·å–ç”¨æˆ·æ‰€æœ‰æƒé™
    private List<String> getUserPermissions(Long userId) {
        return jdbcTemplate.query(
            "SELECT DISTINCT p.name FROM permissions p " +
            "JOIN role_permissions rp ON p.id = rp.permission_id " +
            "JOIN user_roles ur ON rp.role_id = ur.role_id " +
            "WHERE ur.user_id = ?",
            new Object[]{userId},
            (rs, rowNum) -> rs.getString("name")
        );
    }
}
```

---

## 7. ğŸŒ RESTful APIå®‰å…¨è®¾è®¡


### 7.1 RESTfulå®‰å…¨åŸåˆ™


**ğŸ¯ æ ¸å¿ƒå®‰å…¨åŸåˆ™**
```
æ— çŠ¶æ€æ€§ï¼šæ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«è®¤è¯ä¿¡æ¯
ç»Ÿä¸€æ¥å£ï¼šæ ‡å‡†çš„HTTPæ–¹æ³•å’ŒçŠ¶æ€ç 
èµ„æºå¯¼å‘ï¼šåŸºäºèµ„æºè€Œä¸æ˜¯æ“ä½œè®¾è®¡
å®‰å…¨ä¼ è¾“ï¼šHTTPSåŠ å¯†ä¼ è¾“
```

### 7.2 HTTPæ–¹æ³•æƒé™æ˜ å°„


```java
// HTTPæ–¹æ³•ä¸æƒé™çš„å¯¹åº”å…³ç³»
public enum HttpMethodPermission {
    GET("read"),      // è¯»å–æƒé™
    POST("create"),   // åˆ›å»ºæƒé™  
    PUT("update"),    // æ›´æ–°æƒé™
    PATCH("update"),  // éƒ¨åˆ†æ›´æ–°æƒé™
    DELETE("delete"); // åˆ é™¤æƒé™
    
    private final String permission;
    
    HttpMethodPermission(String permission) {
        this.permission = permission;
    }
}

// èµ„æºæƒé™æ£€æŸ¥å™¨
@Component
public class RestfulPermissionChecker {
    
    public boolean checkRestfulPermission(String resource, String method, Long userId) {
        // æ„å»ºæƒé™åç§°ï¼šresource + ":" + method
        String permissionName = buildPermissionName(resource, method);
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è¯¥æƒé™
        return permissionService.hasPermission(userId, permissionName);
    }
    
    private String buildPermissionName(String resource, String method) {
        // /api/users + GET = user:read
        String resourceName = extractResourceName(resource);
        String action = HttpMethodPermission.valueOf(method).getPermission();
        return resourceName + ":" + action;
    }
}
```

### 7.3 èµ„æºçº§æƒé™æ§åˆ¶


```java
// èµ„æºæƒé™æ§åˆ¶ç¤ºä¾‹
@RestController
@RequestMapping("/api")
public class RestfulApiController {
    
    // ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„èµ„æº
    @GetMapping("/users/{id}/profile")
    public UserProfile getUserProfile(@PathVariable Long id, HttpServletRequest request) {
        UserInfo currentUser = getCurrentUser(request);
        
        // æƒé™æ£€æŸ¥ï¼šåªèƒ½è®¿é—®è‡ªå·±çš„èµ„æ–™
        if (!currentUser.getUserId().equals(id) && !isAdmin(currentUser)) {
            throw new ForbiddenException("æ— æƒè®¿é—®è¯¥ç”¨æˆ·èµ„æ–™");
        }
        
        return userService.getUserProfile(id);
    }
    
    // ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰ç”¨æˆ·èµ„æº
    @GetMapping("/admin/users/{id}")
    @RequirePermission({"admin:user:read"})
    public User getUser(@PathVariable Long id) {
        return userService.getUser(id);
    }
}
```

### 7.4 APIç‰ˆæœ¬æ§åˆ¶ä¸æƒé™


```java
// APIç‰ˆæœ¬æƒé™æ§åˆ¶
@RestController
public class VersionedApiController {
    
    // v1ç‰ˆæœ¬API - åŸºç¡€æƒé™
    @GetMapping("/api/v1/users")
    @RequirePermission({"user:read:v1"})
    public List<UserV1> getUsersV1() {
        return userService.getUsersV1();
    }
    
    // v2ç‰ˆæœ¬API - éœ€è¦æ›´é«˜æƒé™
    @GetMapping("/api/v2/users")
    @RequirePermission({"user:read:v2"})
    public List<UserV2> getUsersV2() {
        return userService.getUsersV2();
    }
}
```

---

## 8. ğŸš¦ æ¥å£é™æµä¸ç†”æ–­


### 8.1 ä¸ºä»€ä¹ˆéœ€è¦é™æµ


**ğŸ¯ é™æµçš„ä½œç”¨**
```
ä¿æŠ¤ç³»ç»Ÿï¼šé˜²æ­¢è¿‡è½½å¯¼è‡´ç³»ç»Ÿå´©æºƒ
ä¿éšœæœåŠ¡ï¼šç¡®ä¿æ­£å¸¸ç”¨æˆ·çš„è®¿é—®è´¨é‡
é˜²æ­¢æ”»å‡»ï¼šæŠµå¾¡DDoSæ”»å‡»å’Œæ¶æ„è¯·æ±‚
èµ„æºæ§åˆ¶ï¼šåˆç†åˆ†é…ç³»ç»Ÿèµ„æº
```

### 8.2 é™æµç®—æ³•å®ç°


#### ğŸª£ ä»¤ç‰Œæ¡¶ç®—æ³•


```java
// ä»¤ç‰Œæ¡¶é™æµå™¨
@Component
public class TokenBucketLimiter {
    
    private final Map<String, TokenBucket> buckets = new ConcurrentHashMap<>();
    
    // è·å–æˆ–åˆ›å»ºä»¤ç‰Œæ¡¶
    public TokenBucket getBucket(String key, int capacity, int refillRate) {
        return buckets.computeIfAbsent(key, k -> 
            new TokenBucket(capacity, refillRate));
    }
    
    // å°è¯•è·å–ä»¤ç‰Œ
    public boolean tryAcquire(String key, int tokens) {
        TokenBucket bucket = buckets.get(key);
        return bucket != null && bucket.tryAcquire(tokens);
    }
    
    // ä»¤ç‰Œæ¡¶å®ç°
    public static class TokenBucket {
        private final int capacity;      // æ¡¶å®¹é‡
        private final int refillRate;    // å¡«å……é€Ÿç‡ï¼ˆæ¯ç§’ï¼‰
        private volatile int tokens;     // å½“å‰ä»¤ç‰Œæ•°
        private volatile long lastRefill; // ä¸Šæ¬¡å¡«å……æ—¶é—´
        
        public TokenBucket(int capacity, int refillRate) {
            this.capacity = capacity;
            this.refillRate = refillRate;
            this.tokens = capacity;
            this.lastRefill = System.currentTimeMillis();
        }
        
        public synchronized boolean tryAcquire(int requested) {
            refill(); // å…ˆå¡«å……ä»¤ç‰Œ
            
            if (tokens >= requested) {
                tokens -= requested;
                return true;
            }
            return false;
        }
        
        private void refill() {
            long now = System.currentTimeMillis();
            long elapsed = now - lastRefill;
            
            if (elapsed > 0) {
                int newTokens = (int) (elapsed * refillRate / 1000);
                tokens = Math.min(capacity, tokens + newTokens);
                lastRefill = now;
            }
        }
    }
}
```

#### ğŸªŸ æ»‘åŠ¨çª—å£ç®—æ³•


```java
// æ»‘åŠ¨çª—å£é™æµå™¨
@Component
public class SlidingWindowLimiter {
    
    private final Map<String, SlidingWindow> windows = new ConcurrentHashMap<>();
    
    public boolean isAllowed(String key, int limit, long windowSize) {
        SlidingWindow window = windows.computeIfAbsent(key, 
            k -> new SlidingWindow(windowSize));
        
        return window.isAllowed(limit);
    }
    
    public static class SlidingWindow {
        private final long windowSize;
        private final Queue<Long> requests = new ConcurrentLinkedQueue<>();
        
        public SlidingWindow(long windowSize) {
            this.windowSize = windowSize;
        }
        
        public synchronized boolean isAllowed(int limit) {
            long now = System.currentTimeMillis();
            
            // æ¸…é™¤è¿‡æœŸè¯·æ±‚
            while (!requests.isEmpty() && 
                   now - requests.peek() > windowSize) {
                requests.poll();
            }
            
            // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
            if (requests.size() >= limit) {
                return false;
            }
            
            // è®°å½•å½“å‰è¯·æ±‚
            requests.offer(now);
            return true;
        }
    }
}
```

### 8.3 é™æµæ‹¦æˆªå™¨


```java
// é™æµæ‹¦æˆªå™¨
@Component  
public class RateLimitInterceptor implements HandlerInterceptor {
    
    @Autowired
    private TokenBucketLimiter tokenBucketLimiter;
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) throws Exception {
        
        // è·å–é™æµé…ç½®
        RateLimit rateLimit = getRateLimitAnnotation(handler);
        if (rateLimit == null) {
            return true; // æ— é™æµé…ç½®
        }
        
        // æ„å»ºé™æµKey
        String limitKey = buildLimitKey(request, rateLimit);
        
        // æ£€æŸ¥æ˜¯å¦è¢«é™æµ
        boolean allowed = tokenBucketLimiter.tryAcquire(limitKey, 1);
        
        if (!allowed) {
            // è¿”å›é™æµå“åº”
            response.setStatus(429); // Too Many Requests
            response.setContentType("application/json;charset=UTF-8");
            response.getWriter().write("{\"error\":\"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\"}");
            return false;
        }
        
        return true;
    }
    
    private String buildLimitKey(HttpServletRequest request, RateLimit rateLimit) {
        String key = rateLimit.key();
        
        switch (rateLimit.type()) {
            case IP:
                return "rate_limit:ip:" + getClientIP(request);
            case USER:
                UserInfo user = getCurrentUser(request);
                return "rate_limit:user:" + (user != null ? user.getUserId() : "anonymous");
            case API:
                return "rate_limit:api:" + request.getRequestURI();
            default:
                return "rate_limit:global";
        }
    }
}
```

### 8.4 é™æµæ³¨è§£ä½¿ç”¨


```java
// é™æµæ³¨è§£å®šä¹‰
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RateLimit {
    int value() default 100;                    // é™æµæ•°é‡
    int duration() default 60;                  // æ—¶é—´çª—å£(ç§’)
    RateLimitType type() default RateLimitType.IP; // é™æµç±»å‹
    String key() default "";                    // è‡ªå®šä¹‰key
    String message() default "è¯·æ±‚è¿‡äºé¢‘ç¹";      // é™æµæç¤º
}

// ä½¿ç”¨ç¤ºä¾‹
@RestController
public class ApiController {
    
    // IPé™æµï¼šæ¯åˆ†é’Ÿæœ€å¤š10æ¬¡
    @GetMapping("/api/public/info")
    @RateLimit(value = 10, duration = 60, type = RateLimitType.IP)
    public String getPublicInfo() {
        return "public information";
    }
    
    // ç”¨æˆ·é™æµï¼šæ¯å°æ—¶æœ€å¤š100æ¬¡
    @PostMapping("/api/user/action")
    @RateLimit(value = 100, duration = 3600, type = RateLimitType.USER)
    public String userAction() {
        return "action completed";
    }
    
    // APIé™æµï¼šå…¨å±€æ¯ç§’æœ€å¤š1000æ¬¡
    @GetMapping("/api/search")
    @RateLimit(value = 1000, duration = 1, type = RateLimitType.API)
    public List<String> search(@RequestParam String keyword) {
        return searchService.search(keyword);
    }
}
```

### 8.5 ç†”æ–­æœºåˆ¶å®ç°


```java
// ç®€å•ç†”æ–­å™¨å®ç°
@Component
public class CircuitBreaker {
    
    private final Map<String, CircuitBreakerState> states = new ConcurrentHashMap<>();
    
    public boolean isCallAllowed(String key) {
        CircuitBreakerState state = states.computeIfAbsent(key, 
            k -> new CircuitBreakerState());
        
        return state.isCallAllowed();
    }
    
    public void recordSuccess(String key) {
        CircuitBreakerState state = states.get(key);
        if (state != null) {
            state.recordSuccess();
        }
    }
    
    public void recordFailure(String key) {
        CircuitBreakerState state = states.get(key);
        if (state != null) {
            state.recordFailure();
        }
    }
    
    // ç†”æ–­å™¨çŠ¶æ€
    public static class CircuitBreakerState {
        private volatile State state = State.CLOSED;
        private volatile int failureCount = 0;
        private volatile long lastFailureTime = 0;
        
        private static final int FAILURE_THRESHOLD = 5;  // å¤±è´¥é˜ˆå€¼
        private static final long TIMEOUT = 60000;       // æ¢å¤è¶…æ—¶(1åˆ†é’Ÿ)
        
        public boolean isCallAllowed() {
            if (state == State.OPEN) {
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥å°è¯•æ¢å¤
                if (System.currentTimeMillis() - lastFailureTime > TIMEOUT) {
                    state = State.HALF_OPEN;
                    return true;
                }
                return false;
            }
            return true;
        }
        
        public void recordSuccess() {
            failureCount = 0;
            state = State.CLOSED;
        }
        
        public void recordFailure() {
            failureCount++;
            lastFailureTime = System.currentTimeMillis();
            
            if (failureCount >= FAILURE_THRESHOLD) {
                state = State.OPEN;
            }
        }
        
        enum State {
            CLOSED,    // å…³é—­çŠ¶æ€ï¼ˆæ­£å¸¸ï¼‰
            OPEN,      // æ‰“å¼€çŠ¶æ€ï¼ˆç†”æ–­ï¼‰
            HALF_OPEN  // åŠå¼€çŠ¶æ€ï¼ˆå°è¯•æ¢å¤ï¼‰
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Tokenæœºåˆ¶ï¼šæ•°å­—åŒ–é€šè¡Œè¯ï¼Œæºå¸¦ç”¨æˆ·èº«ä»½ä¿¡æ¯
ğŸ”¸ ä¼ è¾“å®‰å…¨ï¼šHTTPS + Headerä¼ è¾“ï¼Œé¿å…URLæš´éœ²
ğŸ”¸ æœ‰æ•ˆæœŸç®¡ç†ï¼šçŸ­æœŸAccess Token + é•¿æœŸRefresh Token
ğŸ”¸ é»‘åå•æœºåˆ¶ï¼šæ’¤é”€å·²å‘æ”¾Tokençš„å®‰å…¨æ‰‹æ®µ  
ğŸ”¸ æƒé™æ§åˆ¶ï¼šRBACæ¨¡å‹ï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
ğŸ”¸ é™æµç†”æ–­ï¼šä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§çš„é‡è¦æ‰‹æ®µ
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Token vs Session çš„åŒºåˆ«**
```
Sessionï¼ˆæœåŠ¡å™¨å­˜å‚¨ï¼‰:
- æœåŠ¡å™¨å†…å­˜å­˜å‚¨ä¼šè¯ä¿¡æ¯
- å®¢æˆ·ç«¯åªä¿å­˜SessionID  
- æœåŠ¡å™¨é‡å¯ä¼šè¯ä¸¢å¤±
- é€‚åˆå•ä½“åº”ç”¨

Tokenï¼ˆå®¢æˆ·ç«¯å­˜å‚¨ï¼‰:
- å®¢æˆ·ç«¯å­˜å‚¨å®Œæ•´è®¤è¯ä¿¡æ¯
- æœåŠ¡å™¨æ— çŠ¶æ€ï¼ŒåªéªŒè¯ç­¾å
- å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿ
- é€‚åˆå¾®æœåŠ¡æ¶æ„
```

**ğŸ”¹ å®‰å…¨çº§åˆ«çš„å¹³è¡¡**
```
é«˜å®‰å…¨åœºæ™¯ï¼ˆé“¶è¡Œï¼‰ï¼š
âœ… çŸ­æœŸTokenï¼ˆ15åˆ†é’Ÿï¼‰
âœ… å¼ºåˆ¶HTTPS
âœ… å¤šå› ç´ è®¤è¯  
âœ… å®æ—¶é»‘åå•æ£€æŸ¥

æ™®é€šåº”ç”¨åœºæ™¯ï¼š
âœ… ä¸­æœŸTokenï¼ˆ2-24å°æ—¶ï¼‰
âœ… HTTPSæ¨è
âœ… åŸºæœ¬æƒé™æ§åˆ¶
âœ… ç¼“å­˜é»‘åå•æ£€æŸ¥
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
TokenéªŒè¯ä¼˜åŒ–ï¼š
- ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“æŸ¥è¯¢
- å¼‚æ­¥æ›´æ–°é»‘åå•åˆ°ç¼“å­˜
- æ‰¹é‡æƒé™æ£€æŸ¥

é™æµä¼˜åŒ–ï¼š
- é€‰æ‹©åˆé€‚çš„é™æµç®—æ³•
- ä½¿ç”¨Redisåˆ†å¸ƒå¼é™æµ
- è®¾ç½®åˆç†çš„é™æµé˜ˆå€¼
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æŠ€æœ¯é€‰å‹å»ºè®®**

| åœºæ™¯ | **Tokenæ–¹æ¡ˆ** | **ä¼ è¾“æ–¹å¼** | **å­˜å‚¨ä½ç½®** |
|------|-------------|-------------|-------------|
| **ä¼ ç»ŸWebåº”ç”¨** | `è‡ªå®šä¹‰Token` | `Cookieè‡ªåŠ¨æºå¸¦` | `HttpOnly Cookie` |
| **SPAå•é¡µåº”ç”¨** | `JWT` | `Authorization Header` | `LocalStorage` |
| **ç§»åŠ¨ç«¯APP** | `JWT + RefreshToken` | `Authorization Header` | `å®‰å…¨å­˜å‚¨` |
| **å¾®æœåŠ¡ç³»ç»Ÿ** | `JWT` | `Authorization Header` | `å†…å­˜ + æŒä¹…åŒ–` |

**ğŸ”§ æœ€ä½³å®è·µæ¸…å•**
- [x] ä½¿ç”¨HTTPSä¼ è¾“Token
- [x] TokenåŒ…å«è¿‡æœŸæ—¶é—´
- [x] å®ç°Tokené»‘åå•æœºåˆ¶
- [x] åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- [x] APIæ¥å£é™æµä¿æŠ¤
- [x] è®°å½•å®‰å…¨æ“ä½œæ—¥å¿—
- [x] å®šæœŸè½®æ¢å¯†é’¥
- [x] ç›‘æ§å¼‚å¸¸è®¿é—®è¡Œä¸º

**ğŸš¨ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
é¿å…çš„åšæ³•ï¼š
âŒ Tokenæ”¾åœ¨URLå‚æ•°ä¸­
âŒ ä½¿ç”¨æ°¸ä¸è¿‡æœŸçš„Token
âŒ æ˜æ–‡ä¼ è¾“æ•æ„Ÿä¿¡æ¯
âŒ å¿½ç•¥Tokenæ’¤é”€æœºåˆ¶
âŒ æƒé™æ£€æŸ¥é€»è¾‘æ¼æ´

æ¨èçš„åšæ³•ï¼š
âœ… Tokenæ”¾åœ¨Authorization Header
âœ… è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
âœ… ä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“
âœ… å®ç°å®Œå–„çš„æ’¤é”€æœºåˆ¶
âœ… å¤šå±‚æ¬¡æƒé™éªŒè¯
```

### 9.4 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|
| `TokenéªŒè¯å¤±è´¥` | `ç­¾åé”™è¯¯ã€è¿‡æœŸã€æ ¼å¼é—®é¢˜` | `æ£€æŸ¥å¯†é’¥ã€æ—¶é—´åŒæ­¥ã€æ ¼å¼è§„èŒƒ` |
| `æƒé™è¢«æ‹’ç»` | `æƒé™é…ç½®é”™è¯¯ã€è§’è‰²åˆ†é…é—®é¢˜` | `æ£€æŸ¥æƒé™è¡¨ã€ç”¨æˆ·è§’è‰²å…³è”` |
| `æ¥å£è¢«é™æµ` | `è¯·æ±‚é¢‘ç‡è¿‡é«˜ã€é™æµé…ç½®è¿‡ä¸¥` | `è°ƒæ•´é™æµå‚æ•°ã€ä¼˜åŒ–è¯·æ±‚é¢‘ç‡` |
| `é»‘åå•å¤±æ•ˆ` | `ç¼“å­˜åŒæ­¥å»¶è¿Ÿã€æ•°æ®ä¸ä¸€è‡´` | `æ£€æŸ¥Redisè¿æ¥ã€æ•°æ®åº“çŠ¶æ€` |

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- *Tokenè®¤è¯èº«ä»½æ˜ï¼ŒHeaderä¼ è¾“æœ€å®‰å…¨*
- *æœ‰æ•ˆæœŸè®¾ç½®è¦åˆç†ï¼Œé»‘åå•æœºåˆ¶é˜²æ³„éœ²*  
- *æƒé™æ§åˆ¶åˆ†å±‚çº§ï¼Œé™æµç†”æ–­ä¿ç¨³å®š*
- *HTTPSåŠ å¯†æ˜¯åŸºç¡€ï¼Œæ—¥å¿—ç›‘æ§ä¸å¯å°‘*