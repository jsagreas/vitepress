---
title: 4ã€å¾®æœåŠ¡è®¤è¯æŠ€æœ¯æ ˆ
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡è®¤è¯æ¶æ„æ¦‚è¿°](#1-å¾®æœåŠ¡è®¤è¯æ¶æ„æ¦‚è¿°)
2. [å¤šç»ˆç«¯æ”¯æŒä¸Tokenä¼ é€’](#2-å¤šç»ˆç«¯æ”¯æŒä¸Tokenä¼ é€’)
3. [æœåŠ¡é—´è®¤è¯ç­–ç•¥](#3-æœåŠ¡é—´è®¤è¯ç­–ç•¥)
4. [é‰´æƒä¸­é—´ä»¶é›†æˆ](#4-é‰´æƒä¸­é—´ä»¶é›†æˆ)
5. [API Gatewayè®¤è¯é›†æˆ](#5-API-Gatewayè®¤è¯é›†æˆ)
6. [Service Meshè®¤è¯](#6-Service-Meshè®¤è¯)
7. [æœåŠ¡æ²»ç†ä¸è®¤è¯](#7-æœåŠ¡æ²»ç†ä¸è®¤è¯)
8. [æŠ€æœ¯æ ˆé€‰å‹](#8-æŠ€æœ¯æ ˆé€‰å‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ å¾®æœåŠ¡è®¤è¯æ¶æ„æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡è®¤è¯


**ç®€å•ç†è§£**ï¼šå°±åƒå¤§å…¬å¸çš„é—¨ç¦ç³»ç»Ÿï¼Œä¸åŒéƒ¨é—¨éœ€è¦ä¸åŒçš„æƒé™å¡ï¼Œè€Œä¸”å„éƒ¨é—¨ä¹‹é—´äº’ç›¸è®¿é—®ä¹Ÿè¦éªŒè¯èº«ä»½ã€‚

```
ä¼ ç»Ÿå•ä½“åº”ç”¨è®¤è¯ï¼š           å¾®æœåŠ¡è®¤è¯ï¼š
     ç”¨æˆ·                    ç”¨æˆ·
      â†“                      â†“
   [åº”ç”¨ç³»ç»Ÿ]               [è®¤è¯ä¸­å¿ƒ]
      â†“                   â†“    â†“    â†“
   [æ•°æ®åº“]              [è®¢å•] [ç”¨æˆ·] [æ”¯ä»˜]
                           â†‘_______|_____â†‘
                           æœåŠ¡é—´ä¹Ÿè¦è®¤è¯
```

### 1.2 å¾®æœåŠ¡è®¤è¯æ¶æ„å›¾


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¢æˆ·ç«¯å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Webæµè§ˆå™¨  â”‚   æ‰‹æœºApp    â”‚   å°ç¨‹åº     â”‚      H5é¡µé¢          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  APIç½‘å…³å±‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è·¯ç”±è½¬å‘ â”‚ â”‚ è´Ÿè½½å‡è¡¡ â”‚ â”‚ é™æµç†”æ–­ â”‚ â”‚      ç»Ÿä¸€é‰´æƒ        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è®¤è¯ä¸­å¿ƒ                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç”¨æˆ·è®¤è¯ â”‚ â”‚ Tokenç®¡ç†â”‚ â”‚ æƒé™æ§åˆ¶ â”‚ â”‚     OAuth2/JWT      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡æœåŠ¡å±‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ç”¨æˆ·æœåŠ¡ â”‚ â”‚ è®¢å•æœåŠ¡ â”‚ â”‚ æ”¯ä»˜æœåŠ¡ â”‚ â”‚     å…¶ä»–æœåŠ¡         â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚      â†•            â†•           â†•              â†•               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚              æœåŠ¡é—´è®¤è¯Tokenä¼ é€’                        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ ¸å¿ƒè®¤è¯æµç¨‹


**ğŸ”„ å®Œæ•´è®¤è¯æµç¨‹**ï¼š
```
æ­¥éª¤1: ç”¨æˆ·ç™»å½•
æ‰‹æœºApp â†’ APIç½‘å…³ â†’ è®¤è¯ä¸­å¿ƒ
         (éªŒè¯ç”¨æˆ·åå¯†ç )

æ­¥éª¤2: è·å–Token
è®¤è¯ä¸­å¿ƒ â†’ APIç½‘å…³ â†’ æ‰‹æœºApp
         (è¿”å›è®¿é—®Token)

æ­¥éª¤3: ä¸šåŠ¡è¯·æ±‚
æ‰‹æœºApp â†’ APIç½‘å…³ â†’ ä¸šåŠ¡æœåŠ¡
         (æºå¸¦Token)

æ­¥éª¤4: æœåŠ¡é—´è°ƒç”¨
è®¢å•æœåŠ¡ â†’ ç”¨æˆ·æœåŠ¡
         (å†…éƒ¨Token)
```

---

## 2. ğŸ“± å¤šç»ˆç«¯æ”¯æŒä¸Tokenä¼ é€’


### 2.1 å¤šç»ˆç«¯è®¤è¯åœºæ™¯


**ä¸ºä»€ä¹ˆéœ€è¦å¤šç»ˆç«¯æ”¯æŒï¼Ÿ**
ç°åœ¨ç”¨æˆ·ä¼šåŒæ—¶ä½¿ç”¨å¤šä¸ªè®¾å¤‡è®¿é—®åŒä¸€ä¸ªåº”ç”¨ï¼š
- æ—©ä¸Šç”¨æ‰‹æœºAppä¸‹å•
- ä¸­åˆç”¨ç”µè„‘ç½‘é¡µæŸ¥çœ‹è®¢å•
- æ™šä¸Šç”¨å°ç¨‹åºæ”¯ä»˜

### 2.2 å¤šç»ˆç«¯Tokenç­–ç•¥


**ğŸ”‘ ç»Ÿä¸€Tokenæ–¹æ¡ˆ**ï¼š
```javascript
// ä¸åŒç»ˆç«¯ä½¿ç”¨ç›¸åŒçš„Tokenæ ¼å¼
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "refresh_token": "refresh_token_here...",
  "client_type": "mobile_app" // æ ‡è¯†ç»ˆç«¯ç±»å‹
}
```

**ğŸ“± ä¸åŒç»ˆç«¯çš„Tokenè·å–**ï¼š

| ç»ˆç«¯ç±»å‹ | **è·å–æ–¹å¼** | **å­˜å‚¨ä½ç½®** | **ä¼ é€’æ–¹å¼** |
|---------|------------|-------------|-------------|
| ğŸŒ **Webæµè§ˆå™¨** | `ç”¨æˆ·åå¯†ç ç™»å½•` | `localStorage/Cookie` | `Authorizationå¤´éƒ¨` |
| ğŸ“± **æ‰‹æœºApp** | `ç”¨æˆ·åå¯†ç /ç¬¬ä¸‰æ–¹ç™»å½•` | `æœ¬åœ°å®‰å…¨å­˜å‚¨` | `Authorizationå¤´éƒ¨` |
| ğŸ”— **å°ç¨‹åº** | `å¾®ä¿¡æˆæƒ/æ‰‹æœºå·ç™»å½•` | `æœ¬åœ°å­˜å‚¨` | `headerå‚æ•°` |
| ğŸ’» **H5é¡µé¢** | `è·³è½¬ç™»å½•/æ‰«ç ç™»å½•` | `sessionStorage` | `URLå‚æ•°æˆ–å¤´éƒ¨` |

### 2.3 Tokenä¼ é€’æœºåˆ¶


**ğŸ”„ å†…éƒ¨æœåŠ¡Tokenä¼ é€’**ï¼š
```java
@RestController
public class OrderController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/order/{id}")
    public Order getOrder(@PathVariable String id, HttpServletRequest request) {
        // 1. ä»è¯·æ±‚å¤´è·å–ç”¨æˆ·Token
        String userToken = request.getHeader("Authorization");
        
        // 2. è°ƒç”¨ç”¨æˆ·æœåŠ¡æ—¶ä¼ é€’Token
        User user = userService.getUser(userId, userToken);
        
        return orderService.getOrder(id, user);
    }
}

// ç”¨æˆ·æœåŠ¡æ¥å£è°ƒç”¨
@FeignClient("user-service")
public interface UserService {
    
    @GetMapping("/user/{id}")
    User getUser(@PathVariable String id, 
                @RequestHeader("Authorization") String token);
}
```

**ğŸ”’ æœåŠ¡é—´Tokenç”Ÿæˆ**ï¼š
```java
// ä¸ºæœåŠ¡é—´è°ƒç”¨ç”Ÿæˆå†…éƒ¨Token
public class InternalTokenGenerator {
    
    public String generateServiceToken(String serviceName) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("service", serviceName);
        claims.put("type", "internal");
        claims.put("permissions", getServicePermissions(serviceName));
        
        return JWT.create()
            .withClaim("claims", claims)
            .withExpiresAt(new Date(System.currentTimeMillis() + 300000)) // 5åˆ†é’Ÿ
            .sign(Algorithm.HMAC256(SECRET));
    }
}
```

---

## 3. ğŸ” æœåŠ¡é—´è®¤è¯ç­–ç•¥


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡é—´è®¤è¯


**çœŸå®åœºæ™¯ä¸¾ä¾‹**ï¼š
```
ç”¨æˆ·ä¸‹å•æµç¨‹ï¼š
ç”¨æˆ· â†’ è®¢å•æœåŠ¡ â†’ éœ€è¦è°ƒç”¨ï¼š
                  â”œâ”€ ç”¨æˆ·æœåŠ¡ï¼ˆéªŒè¯ç”¨æˆ·ä¿¡æ¯ï¼‰
                  â”œâ”€ åº“å­˜æœåŠ¡ï¼ˆæ£€æŸ¥å•†å“åº“å­˜ï¼‰  
                  â”œâ”€ æ”¯ä»˜æœåŠ¡ï¼ˆåˆ›å»ºæ”¯ä»˜è®¢å•ï¼‰
                  â””â”€ é€šçŸ¥æœåŠ¡ï¼ˆå‘é€è®¢å•é€šçŸ¥ï¼‰
```

å¦‚æœæ²¡æœ‰æœåŠ¡é—´è®¤è¯ï¼Œä»»ä½•äººéƒ½èƒ½ç›´æ¥è°ƒç”¨å†…éƒ¨æœåŠ¡ï¼Œè¿™å¾ˆå±é™©ï¼

### 3.2 æœåŠ¡åˆ°æœåŠ¡(S2S)è®¤è¯


**ğŸ”‘ S2Sè®¤è¯åŸç†**ï¼š
æ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„"èº«ä»½è¯"ï¼ŒæœåŠ¡é—´è°ƒç”¨æ—¶éœ€è¦å‡ºç¤ºèº«ä»½è¯ã€‚

```java
// æœåŠ¡Aè°ƒç”¨æœåŠ¡Bçš„è®¤è¯æµç¨‹
public class ServiceAuthClient {
    
    // 1. è·å–æœåŠ¡è®¤è¯Token
    private String getServiceToken() {
        String clientId = "order-service";
        String clientSecret = "service_secret_key";
        
        return oauthClient.getClientCredentialsToken(clientId, clientSecret);
    }
    
    // 2. è°ƒç”¨å…¶ä»–æœåŠ¡æ—¶æºå¸¦Token
    public User callUserService(String userId) {
        String serviceToken = getServiceToken();
        
        HttpHeaders headers = new HttpHeaders();
        headers.set("Authorization", "Bearer " + serviceToken);
        headers.set("X-Service-Name", "order-service");
        
        return restTemplate.exchange(
            "http://user-service/users/" + userId,
            HttpMethod.GET,
            new HttpEntity<>(headers),
            User.class
        ).getBody();
    }
}
```

### 3.3 mTLSåŒå‘è®¤è¯


**ä»€ä¹ˆæ˜¯mTLSï¼Ÿ**
mTLSå°±åƒåŒæ–¹éƒ½è¦å‡ºç¤ºèº«ä»½è¯çš„éªŒè¯æ–¹å¼ï¼Œæ¯”å•å‘éªŒè¯æ›´å®‰å…¨ã€‚

```
æ™®é€šTLSï¼ˆå•å‘è®¤è¯ï¼‰ï¼š        mTLSï¼ˆåŒå‘è®¤è¯ï¼‰ï¼š
å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯               å®¢æˆ·ç«¯ â‡„ æœåŠ¡ç«¯
"ä½ æ˜¯è°ï¼Ÿ"                   "ä½ æ˜¯è°ï¼Ÿæˆ‘ä¹Ÿæ˜¯è°ï¼Ÿ"
      â† è¯ä¹¦                      â‡„ åŒæ–¹è¯ä¹¦
```

**ğŸ”’ mTLSé…ç½®ç¤ºä¾‹**ï¼š
```yaml
# æœåŠ¡é…ç½®
server:
  ssl:
    enabled: true
    # æœåŠ¡ç«¯è¯ä¹¦
    key-store: /certs/service.p12
    key-store-password: password
    # å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯
    client-auth: need
    trust-store: /certs/trust.p12
    trust-store-password: password

# å®¢æˆ·ç«¯é…ç½®  
http:
  client:
    ssl:
      key-store: /certs/client.p12
      trust-store: /certs/trust.p12
```

### 3.4 å†…éƒ¨Tokenä¼ é€’æœ€ä½³å®è·µ


**ğŸ¯ Tokenä¼ é€’ç­–ç•¥**ï¼š
```java
@Component
public class TokenPropagationInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        // 1. æå–ç”¨æˆ·Token
        String userToken = request.getHeader("Authorization");
        
        // 2. ç”Ÿæˆè°ƒç”¨é“¾Tokenï¼ˆåŒ…å«åŸå§‹ç”¨æˆ·ä¿¡æ¯ï¼‰
        String chainToken = generateChainToken(userToken, request);
        
        // 3. å­˜å‚¨åœ¨çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­ï¼Œä¾›åç»­è°ƒç”¨ä½¿ç”¨
        TokenContext.setChainToken(chainToken);
        
        return true;
    }
    
    private String generateChainToken(String userToken, HttpServletRequest request) {
        // è§£æç”¨æˆ·Tokenè·å–ç”¨æˆ·ä¿¡æ¯
        Claims userClaims = JWT.decode(userToken);
        
        // åˆ›å»ºè°ƒç”¨é“¾Token
        return JWT.create()
            .withClaim("user_id", userClaims.get("user_id"))
            .withClaim("user_role", userClaims.get("role"))
            .withClaim("service_chain", request.getRequestURI())
            .withClaim("timestamp", System.currentTimeMillis())
            .sign(Algorithm.HMAC256(INTERNAL_SECRET));
    }
}
```

---

## 4. ğŸ›¡ï¸ é‰´æƒä¸­é—´ä»¶é›†æˆ


### 4.1 ä»€ä¹ˆæ˜¯é‰´æƒä¸­é—´ä»¶


**é€šä¿—ç†è§£**ï¼šé‰´æƒä¸­é—´ä»¶å°±åƒå…¬å¸çš„å®‰ä¿ç³»ç»Ÿï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰äººçš„è¿›å‡ºæƒé™ã€‚

```
æ²¡æœ‰ä¸­é—´ä»¶ï¼š                   æœ‰é‰´æƒä¸­é—´ä»¶ï¼š
æ¯ä¸ªæœåŠ¡è‡ªå·±éªŒè¯æƒé™              ç»Ÿä¸€çš„æƒé™ç®¡ç†

æœåŠ¡A â† ç”¨æˆ·éªŒè¯                     ç”¨æˆ·
æœåŠ¡B â† ç”¨æˆ·éªŒè¯                      â†“
æœåŠ¡C â† ç”¨æˆ·éªŒè¯                 [é‰´æƒä¸­é—´ä»¶]
   (é‡å¤å¼€å‘)                    â†“    â†“    â†“
                              æœåŠ¡A  æœåŠ¡B  æœåŠ¡C
```

### 4.2 Kongé‰´æƒé›†æˆ


**Kongç®€ä»‹**ï¼šKongæ˜¯ä¸€ä¸ªAPIç½‘å…³ï¼Œå¯ä»¥ç»Ÿä¸€å¤„ç†è®¤è¯ã€é‰´æƒã€é™æµç­‰åŠŸèƒ½ã€‚

**ğŸ”§ Kong OAuth2æ’ä»¶é…ç½®**ï¼š
```bash
# 1. åˆ›å»ºæœåŠ¡
curl -i -X POST http://localhost:8001/services/ \
  --data "name=user-service" \
  --data "url=http://user-service:8080"

# 2. åˆ›å»ºè·¯ç”±
curl -i -X POST http://localhost:8001/services/user-service/routes \
  --data "paths[]=/api/users"

# 3. å¯ç”¨OAuth2æ’ä»¶
curl -i -X POST http://localhost:8001/services/user-service/plugins \
  --data "name=oauth2" \
  --data "config.scopes=read,write" \
  --data "config.token_expiration=3600"
```

**ğŸ” Kong JWTéªŒè¯**ï¼š
```javascript
// å®¢æˆ·ç«¯è¯·æ±‚ç¤ºä¾‹
fetch('http://api.example.com/api/users', {
  headers: {
    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...',
    'Content-Type': 'application/json'
  }
})
.then(response => response.json())
.then(data => console.log(data));
```

### 4.3 Keycloaké›†æˆ


**Keycloakç®€ä»‹**ï¼šKeycloakæ˜¯ä¸“ä¸šçš„èº«ä»½è®¤è¯å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚

**ğŸ—ï¸ Keycloakæ¶æ„é›†æˆ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯åº”ç”¨   â”‚â”€â”€â”€â–¶â”‚  Keycloak   â”‚â—€â”€â”€â”€â”‚   åç«¯æœåŠ¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   ç”¨æˆ·æ•°æ®   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”‘ Spring Booté›†æˆKeycloak**ï¼š
```yaml
# application.yml
keycloak:
  realm: my-app-realm
  auth-server-url: http://localhost:8080/auth
  resource: my-app-client
  public-client: true
  
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://localhost:8080/auth/realms/my-app-realm/protocol/openid-connect/certs
```

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/public/**").permitAll()
                .requestMatchers("/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .oauth2ResourceServer(oauth2 -> oauth2.jwt(Customizer.withDefaults()))
            .build();
    }
}
```

### 4.4 é‰´æƒä¸­é—´ä»¶éƒ¨ç½²ç­–ç•¥


**ğŸš€ éƒ¨ç½²æ¨¡å¼é€‰æ‹©**ï¼š

| éƒ¨ç½²æ¨¡å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|----------|----------|-------------|
| **ğŸ”— Sidecaræ¨¡å¼** | `ä¸æœåŠ¡è§£è€¦ï¼Œç‹¬ç«‹å‡çº§` | `ç½‘ç»œå»¶è¿Ÿå¢åŠ ` | `Service Meshç¯å¢ƒ` |
| **ğŸ“¦ åµŒå…¥æ¨¡å¼** | `æ€§èƒ½å¥½ï¼Œå»¶è¿Ÿä½` | `ä¸ä¸šåŠ¡è€¦åˆ` | `æ€§èƒ½è¦æ±‚é«˜` |
| **ğŸŒ ç½‘å…³æ¨¡å¼** | `ç»Ÿä¸€ç®¡ç†ï¼Œé…ç½®ç®€å•` | `å•ç‚¹æ•…éšœé£é™©` | `ä¸­å°å‹ç³»ç»Ÿ` |

---

## 5. ğŸŒ API Gatewayè®¤è¯é›†æˆ


### 5.1 APIç½‘å…³çš„è®¤è¯ä½œç”¨


**ä¸ºä»€ä¹ˆéœ€è¦åœ¨ç½‘å…³åšè®¤è¯ï¼Ÿ**
APIç½‘å…³å°±åƒå°åŒºçš„é—¨å«ï¼Œæ‰€æœ‰å¤–æ¥äººå‘˜éƒ½è¦åœ¨é—¨å£ç™»è®°éªŒè¯ï¼Œé€šè¿‡åæ‰èƒ½è¿›å…¥å„ä¸ªæ¥¼æ ‹ã€‚

```
è¯·æ±‚æµç¨‹ï¼š
å¤–éƒ¨ç”¨æˆ· â†’ [APIç½‘å…³è®¤è¯] â†’ å†…éƒ¨æœåŠ¡
                â”‚
              éªŒè¯Token
              æ£€æŸ¥æƒé™
              è®°å½•æ—¥å¿—
```

### 5.2 ç½‘å…³è®¤è¯å®ç°


**ğŸ”’ Spring Cloud Gatewayè®¤è¯**ï¼š
```java
@Component
public class AuthenticationFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        
        // 1. æ£€æŸ¥æ˜¯å¦éœ€è¦è®¤è¯
        if (isPublicPath(request.getPath().toString())) {
            return chain.filter(exchange);
        }
        
        // 2. æå–Token
        String token = extractToken(request);
        if (token == null) {
            return unauthorizedResponse(exchange);
        }
        
        // 3. éªŒè¯Token
        return validateToken(token)
            .flatMap(userInfo -> {
                // 4. æ·»åŠ ç”¨æˆ·ä¿¡æ¯åˆ°è¯·æ±‚å¤´
                ServerHttpRequest modifiedRequest = request.mutate()
                    .header("X-User-Id", userInfo.getId())
                    .header("X-User-Role", userInfo.getRole())
                    .build();
                
                ServerWebExchange modifiedExchange = 
                    exchange.mutate().request(modifiedRequest).build();
                
                return chain.filter(modifiedExchange);
            })
            .onErrorResume(error -> unauthorizedResponse(exchange));
    }
    
    private String extractToken(ServerHttpRequest request) {
        String authHeader = request.getHeaders().getFirst("Authorization");
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            return authHeader.substring(7);
        }
        return null;
    }
}
```

### 5.3 ç½‘å…³è·¯ç”±æƒé™æ§åˆ¶


**ğŸ¯ åŸºäºè·¯å¾„çš„æƒé™æ§åˆ¶**ï¼š
```yaml
# Gatewayè·¯ç”±é…ç½®
spring:
  cloud:
    gateway:
      routes:
      - id: user-route
        uri: lb://user-service
        predicates:
        - Path=/api/users/**
        filters:
        - name: AuthorizeFilter
          args:
            required-role: USER
            
      - id: admin-route  
        uri: lb://admin-service
        predicates:
        - Path=/api/admin/**
        filters:
        - name: AuthorizeFilter
          args:
            required-role: ADMIN
```

**ğŸ” åŠ¨æ€æƒé™éªŒè¯**ï¼š
```java
@Component
public class AuthorizeFilter implements GatewayFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        // 1. è·å–ç”¨æˆ·è§’è‰²
        String userRole = exchange.getRequest().getHeaders().getFirst("X-User-Role");
        String requiredRole = getRequiredRole(exchange);
        
        // 2. æ£€æŸ¥æƒé™
        if (!hasPermission(userRole, requiredRole)) {
            return forbiddenResponse(exchange);
        }
        
        return chain.filter(exchange);
    }
    
    private boolean hasPermission(String userRole, String requiredRole) {
        // è§’è‰²å±‚çº§æ£€æŸ¥
        Map<String, Integer> roleLevel = Map.of(
            "USER", 1,
            "ADMIN", 2,
            "SUPER_ADMIN", 3
        );
        
        return roleLevel.getOrDefault(userRole, 0) >= 
               roleLevel.getOrDefault(requiredRole, 0);
    }
}
```

---

## 6. ğŸ•¸ï¸ Service Meshè®¤è¯


### 6.1 ä»€ä¹ˆæ˜¯Service Meshè®¤è¯


**Service Meshç®€ä»‹**ï¼šService Meshå°±åƒç»™æ¯ä¸ªæœåŠ¡éƒ½é…äº†ä¸€ä¸ªä¸“é—¨çš„ä¿é•–ï¼ˆä»£ç†ï¼‰ï¼Œä¿é•–ä¹‹é—´äº’ç›¸è®¤è¯†ï¼Œè´Ÿè´£å®‰å…¨é€šä¿¡ã€‚

```
ä¼ ç»ŸæœåŠ¡é—´è°ƒç”¨ï¼š              Service Meshè°ƒç”¨ï¼š
æœåŠ¡A â†’ æœåŠ¡B                æœåŠ¡A â†’ ä»£ç†A â†’ ä»£ç†B â†’ æœåŠ¡B
   (ç›´æ¥è°ƒç”¨)                      (é€šè¿‡ä»£ç†å®‰å…¨é€šä¿¡)
```

### 6.2 Istioè®¤è¯ç­–ç•¥


**ğŸ”’ IstioåŒé‡è®¤è¯æœºåˆ¶**ï¼š
- **æœåŠ¡é—´è®¤è¯**ï¼šç¡®ä¿æœåŠ¡èº«ä»½çœŸå®æ€§
- **ç»ˆç«¯ç”¨æˆ·è®¤è¯**ï¼šéªŒè¯æœ€ç»ˆç”¨æˆ·æƒé™

**Istioè®¤è¯é…ç½®**ï¼š
```yaml
# å¯ç”¨æœåŠ¡é—´mTLS
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: production
spec:
  mtls:
    mode: STRICT  # å¼ºåˆ¶mTLS
    
---
# JWT TokenéªŒè¯
apiVersion: security.istio.io/v1beta1
kind: RequestAuthentication
metadata:
  name: jwt-auth
  namespace: production
spec:
  jwtRules:
  - issuer: "https://auth.example.com"
    jwksUri: "https://auth.example.com/.well-known/jwks.json"
    
---
# æˆæƒç­–ç•¥
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: user-service-policy
  namespace: production
spec:
  selector:
    matchLabels:
      app: user-service
  rules:
  - when:
    - key: request.auth.claims[role]
      values: ["admin", "user"]
```

### 6.3 Envoyä»£ç†è®¤è¯


**Envoyè®¤è¯æµç¨‹**ï¼š
```
è¯·æ±‚ â†’ Envoyä»£ç† â†’ [JWTéªŒè¯] â†’ [mTLSéªŒè¯] â†’ ç›®æ ‡æœåŠ¡
            â”‚           â”‚            â”‚
         æå–Token    éªŒè¯ç­¾å     éªŒè¯è¯ä¹¦
```

**ğŸ”§ Envoy JWTè¿‡æ»¤å™¨é…ç½®**ï¼š
```yaml
http_filters:
- name: envoy.filters.http.jwt_authn
  typed_config:
    "@type": type.googleapis.com/envoy.extensions.filters.http.jwt_authn.v3.JwtAuthentication
    providers:
      auth_provider:
        issuer: https://auth.example.com
        remote_jwks:
          http_uri:
            uri: https://auth.example.com/.well-known/jwks.json
    rules:
    - match:
        prefix: /api/
      requires:
        provider_name: auth_provider
```

---

## 7. âš™ï¸ æœåŠ¡æ²»ç†ä¸è®¤è¯


### 7.1 æœåŠ¡å‘ç°ä¸è®¤è¯


**ä¸ºä»€ä¹ˆæœåŠ¡å‘ç°éœ€è¦è®¤è¯ï¼Ÿ**
åœ¨å¾®æœåŠ¡ç¯å¢ƒä¸­ï¼ŒæœåŠ¡ä¼šåŠ¨æ€æ³¨å†Œå’Œå‘ç°ï¼Œéœ€è¦ç¡®ä¿åªæœ‰åˆæ³•çš„æœåŠ¡æ‰èƒ½æ³¨å†Œå’Œè¢«å‘ç°ã€‚

**ğŸ” ConsulæœåŠ¡å‘ç°è®¤è¯**ï¼š
```json
{
  "service": {
    "name": "user-service",
    "port": 8080,
    "tags": ["v1.0", "production"],
    "check": {
      "http": "http://localhost:8080/health",
      "interval": "10s"
    },
    "meta": {
      "service_token": "service_secret_token",
      "environment": "production"
    }
  }
}
```

**ğŸ“‹ Eurekaå®‰å…¨é…ç½®**ï¼š
```yaml
# Eureka Serveré…ç½®
eureka:
  server:
    enable-self-preservation: false
  client:
    service-url:
      defaultZone: http://admin:password@eureka-server:8761/eureka/

# æœåŠ¡æ³¨å†Œè®¤è¯
spring:
  security:
    user:
      name: admin
      password: secure_password
```

### 7.2 ç†”æ–­é™çº§ä¸è®¤è¯


**ğŸ”¥ è®¤è¯å¤±è´¥çš„ç†”æ–­å¤„ç†**ï¼š
```java
@Component
public class AuthCircuitBreaker {
    
    private final CircuitBreaker circuitBreaker;
    
    public AuthCircuitBreaker() {
        this.circuitBreaker = CircuitBreaker.ofDefaults("auth-service");
        circuitBreaker.getEventPublisher()
            .onStateTransition(event -> 
                log.info("è®¤è¯æœåŠ¡çŠ¶æ€å˜æ›´: {}", event));
    }
    
    @CircuitBreaker(name = "auth-service", fallbackMethod = "authFallback")
    public boolean validateToken(String token) {
        return authService.validateToken(token);
    }
    
    // è®¤è¯å¤±è´¥é™çº§ç­–ç•¥
    public boolean authFallback(String token, Exception ex) {
        log.warn("è®¤è¯æœåŠ¡ä¸å¯ç”¨ï¼Œå¯ç”¨é™çº§ç­–ç•¥: {}", ex.getMessage());
        
        // 1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜çš„Token
        if (localTokenCache.isValid(token)) {
            return true;
        }
        
        // 2. å…è®¸éƒ¨åˆ†å…¬å…±æ¥å£è®¿é—®
        if (isPublicEndpoint()) {
            return true;
        }
        
        // 3. è®°å½•å¤±è´¥æ—¥å¿—
        auditLog.logAuthFailure(token, ex);
        
        return false;
    }
}
```

### 7.3 é“¾è·¯è¿½è¸ªä¸è®¤è¯


**ğŸ” è®¤è¯é“¾è·¯è¿½è¸ª**ï¼š
```java
@Component
public class AuthTracingInterceptor {
    
    private final Tracer tracer;
    
    public boolean authenticateRequest(String token, HttpServletRequest request) {
        // åˆ›å»ºè®¤è¯è¿½è¸ªSpan
        Span authSpan = tracer.nextSpan()
            .name("authentication")
            .tag("token.type", getTokenType(token))
            .tag("request.path", request.getRequestURI())
            .tag("client.ip", getClientIp(request))
            .start();
        
        try (Tracer.SpanInScope ws = tracer.withSpanInScope(authSpan)) {
            // 1. TokenéªŒè¯
            Span validateSpan = tracer.nextSpan()
                .name("token-validation")
                .start();
            
            boolean isValid = false;
            try (Tracer.SpanInScope validateScope = tracer.withSpanInScope(validateSpan)) {
                isValid = tokenValidator.validate(token);
                validateSpan.tag("validation.result", String.valueOf(isValid));
            } finally {
                validateSpan.end();
            }
            
            // 2. æƒé™æ£€æŸ¥
            if (isValid) {
                Span authzSpan = tracer.nextSpan()
                    .name("authorization-check")
                    .start();
                
                try (Tracer.SpanInScope authzScope = tracer.withSpanInScope(authzSpan)) {
                    boolean hasPermission = checkPermissions(token, request);
                    authzSpan.tag("authorization.result", String.valueOf(hasPermission));
                    return hasPermission;
                } finally {
                    authzSpan.end();
                }
            }
            
            return false;
        } finally {
            authSpan.end();
        }
    }
}
```

**ğŸ“Š è®¤è¯æ€§èƒ½ç›‘æ§**ï¼š
```java
@Component
public class AuthMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Counter authSuccessCounter;
    private final Counter authFailureCounter;
    private final Timer authTimer;
    
    public AuthMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.authSuccessCounter = Counter.builder("auth.success")
            .description("è®¤è¯æˆåŠŸæ¬¡æ•°")
            .register(meterRegistry);
        this.authFailureCounter = Counter.builder("auth.failure")
            .description("è®¤è¯å¤±è´¥æ¬¡æ•°")
            .register(meterRegistry);
        this.authTimer = Timer.builder("auth.duration")
            .description("è®¤è¯è€—æ—¶")
            .register(meterRegistry);
    }
    
    public void recordAuthSuccess(String tokenType) {
        authSuccessCounter.increment(Tags.of("token.type", tokenType));
    }
    
    public void recordAuthFailure(String reason) {
        authFailureCounter.increment(Tags.of("failure.reason", reason));
    }
}
```

---

## 8. ğŸ› ï¸ æŠ€æœ¯æ ˆé€‰å‹


### 8.1 Spring CloudæŠ€æœ¯æ ˆ


**ğŸŒ± Spring Cloudè®¤è¯ç»„ä»¶**ï¼š
```yaml
# æ ¸å¿ƒç»„ä»¶é€‰æ‹©
authentication:
  - Spring Security OAuth2
  - Spring Cloud Security
  - JWT Tokenå¤„ç†
  
gateway:
  - Spring Cloud Gateway
  - ç»Ÿä¸€è®¤è¯å…¥å£
  - åŠ¨æ€è·¯ç”±é…ç½®
  
discovery:
  - Eureka / Consul
  - æœåŠ¡æ³¨å†Œå‘ç°
  - å¥åº·æ£€æŸ¥
```

**Spring Cloudè®¤è¯æ¶æ„**ï¼š
```java
// èµ„æºæœåŠ¡å™¨é…ç½®
@EnableResourceServer
@Configuration
public class ResourceServerConfig extends ResourceServerConfigurerAdapter {
    
    @Override
    public void configure(HttpSecurity http) throws Exception {
        http.authorizeRequests()
            .antMatchers("/public/**").permitAll()
            .antMatchers("/api/admin/**").hasRole("ADMIN")
            .anyRequest().authenticated();
    }
    
    @Bean
    public TokenStore tokenStore() {
        return new JwtTokenStore(jwtAccessTokenConverter());
    }
}
```

### 8.2 Istio Service Mesh


**ğŸ•¸ï¸ Istioè®¤è¯ä¼˜åŠ¿**ï¼š
- **è‡ªåŠ¨mTLS**ï¼šæœåŠ¡é—´é€šä¿¡è‡ªåŠ¨åŠ å¯†
- **é›¶ä¿¡ä»»ç½‘ç»œ**ï¼šé»˜è®¤æ‹’ç»æ‰€æœ‰é€šä¿¡
- **ç»†ç²’åº¦æ§åˆ¶**ï¼šåŸºäºå·¥ä½œè´Ÿè½½çš„ç²¾ç¡®æƒé™æ§åˆ¶

**Istioä¸ä¼ ç»Ÿè®¤è¯å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | **ä¼ ç»Ÿè®¤è¯** | **Istioè®¤è¯** |
|------|-------------|-------------|
| **éƒ¨ç½²å¤æ‚åº¦** | `éœ€è¦æ¯ä¸ªæœåŠ¡é›†æˆ` | `è‡ªåŠ¨æ³¨å…¥ï¼Œé€æ˜åŒ–` |
| **æ€§èƒ½å¼€é”€** | `ä¸šåŠ¡ä»£ç ä¸­å¤„ç†` | `Sidecarä»£ç†å¤„ç†` |
| **å®‰å…¨çº§åˆ«** | `ä¾èµ–å¼€å‘å®ç°` | `å¹³å°çº§å®‰å…¨ä¿éšœ` |
| **å‡çº§ç»´æŠ¤** | `æ¯ä¸ªæœåŠ¡å•ç‹¬å‡çº§` | `ç»Ÿä¸€å‡çº§ä»£ç†` |

### 8.3 Kong + Keycloakç»„åˆ


**ğŸ”— Kong + Keycloakæ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯     â”‚â”€â”€â”€â–¶â”‚    Kong     â”‚â”€â”€â”€â–¶â”‚  åç«¯æœåŠ¡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   Gateway   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           
                          â”‚                    
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           
                   â”‚  Keycloak   â”‚           
                   â”‚  è®¤è¯ä¸­å¿ƒ    â”‚           
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           
```

**ğŸ”§ é›†æˆé…ç½®**ï¼š
```bash
# Kong OIDCæ’ä»¶é…ç½®
curl -X POST http://kong:8001/plugins \
  --data "name=oidc" \
  --data "config.client_id=kong-client" \
  --data "config.client_secret=client-secret" \
  --data "config.discovery=http://keycloak:8080/auth/realms/master/.well-known/openid_connect_configuration"
```

### 8.4 Envoyä»£ç†


**âš¡ Envoyè®¤è¯ç‰¹ç‚¹**ï¼š
- **é«˜æ€§èƒ½**ï¼šC++å®ç°ï¼Œæ€§èƒ½ä¼˜å¼‚
- **å¯è§‚æµ‹æ€§**ï¼šä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡
- **çµæ´»é…ç½®**ï¼šæ”¯æŒå¤æ‚çš„è®¤è¯ç­–ç•¥

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¾®æœåŠ¡è®¤è¯æ¶æ„ï¼šå®¢æˆ·ç«¯ â†’ APIç½‘å…³ â†’ è®¤è¯ä¸­å¿ƒ â†’ ä¸šåŠ¡æœåŠ¡
ğŸ”¸ å¤šç»ˆç«¯Tokenç­–ç•¥ï¼šç»Ÿä¸€Tokenæ ¼å¼ï¼Œä¸åŒå­˜å‚¨å’Œä¼ é€’æ–¹å¼
ğŸ”¸ æœåŠ¡é—´è®¤è¯ï¼šS2Sè®¤è¯ã€mTLSåŒå‘è®¤è¯ã€å†…éƒ¨Tokenä¼ é€’
ğŸ”¸ é‰´æƒä¸­é—´ä»¶ï¼šKongã€Keycloakç­‰ç»Ÿä¸€æƒé™ç®¡ç†
ğŸ”¸ Service Meshï¼šIstioã€Envoyé€æ˜åŒ–å®‰å…¨é€šä¿¡
```

### 9.2 å…³é”®æ¶æ„é€‰æ‹©


**ğŸ¯ å°å‹ç³»ç»Ÿï¼ˆ< 10ä¸ªæœåŠ¡ï¼‰**ï¼š
```
æ¨èæ–¹æ¡ˆï¼šSpring Cloud + JWT
- ç®€å•æ˜“å®ç°
- å­¦ä¹ æˆæœ¬ä½
- ç»´æŠ¤ç®€å•
```

**ğŸš€ ä¸­å‹ç³»ç»Ÿï¼ˆ10-50ä¸ªæœåŠ¡ï¼‰**ï¼š
```
æ¨èæ–¹æ¡ˆï¼šKong + Keycloak
- ä¸“ä¸šæƒé™ç®¡ç†
- æ€§èƒ½ç¨³å®š
- åŠŸèƒ½å®Œæ•´
```

**ğŸŒ å¤§å‹ç³»ç»Ÿï¼ˆ> 50ä¸ªæœåŠ¡ï¼‰**ï¼š
```
æ¨èæ–¹æ¡ˆï¼šIstio Service Mesh
- å¹³å°çº§å®‰å…¨
- é›¶ä¿¡ä»»æ¶æ„
- è‡ªåŠ¨åŒ–ç®¡ç†
```

### 9.3 å®æ–½å…³é”®ç‚¹


**ğŸ”’ å®‰å…¨åŸåˆ™**ï¼š
- **æœ€å°æƒé™**ï¼šåªæˆäºˆå¿…è¦çš„æƒé™
- **æ·±åº¦é˜²å¾¡**ï¼šå¤šå±‚å®‰å…¨éªŒè¯
- **é›¶ä¿¡ä»»**ï¼šä¸ä¿¡ä»»ä»»ä½•é»˜è®¤è¿æ¥

**ğŸ“Š æ€§èƒ½è€ƒè™‘**ï¼š
- **Tokenç¼“å­˜**ï¼šå‡å°‘è®¤è¯æœåŠ¡å‹åŠ›
- **è¿æ¥æ± **ï¼šä¼˜åŒ–æœåŠ¡é—´è°ƒç”¨
- **å¼‚æ­¥å¤„ç†**ï¼šæé«˜å“åº”é€Ÿåº¦

**ğŸ” è¿ç»´ç›‘æ§**ï¼š
- **é“¾è·¯è¿½è¸ª**ï¼šè¿½è¸ªè®¤è¯è°ƒç”¨é“¾è·¯
- **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§è®¤è¯è€—æ—¶å’ŒæˆåŠŸç‡
- **å®‰å…¨å®¡è®¡**ï¼šè®°å½•æ‰€æœ‰è®¤è¯äº‹ä»¶

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¾®æœåŠ¡è®¤è¯éœ€è¦è€ƒè™‘å¤šç»ˆç«¯ã€æœåŠ¡é—´ã€ç½‘å…³ä¸‰ä¸ªå±‚é¢
- é€‰æ‹©æŠ€æœ¯æ ˆè¦æ ¹æ®ç³»ç»Ÿè§„æ¨¡å’Œå¤æ‚åº¦
- å®‰å…¨å’Œæ€§èƒ½éœ€è¦å¹³è¡¡ï¼Œä¸èƒ½åªè€ƒè™‘ä¸€æ–¹é¢
- ç»Ÿä¸€çš„è®¤è¯æ¶æ„æ¯”åˆ†æ•£å®ç°æ›´å®¹æ˜“ç®¡ç†å’Œç»´æŠ¤