---
title: 12ã€å¯†é’¥ä¸æœºå¯†ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [å¯†é’¥ä¸æœºå¯†ç®¡ç†æ¦‚è¿°](#1-å¯†é’¥ä¸æœºå¯†ç®¡ç†æ¦‚è¿°)
2. [å¯†é’¥æ¥æºç®¡ç†](#2-å¯†é’¥æ¥æºç®¡ç†)
3. [å¯†é’¥è½®æ¢ç­–ç•¥](#3-å¯†é’¥è½®æ¢ç­–ç•¥)
4. [æœºå¯†åˆ†å‘æœºåˆ¶](#4-æœºå¯†åˆ†å‘æœºåˆ¶)
5. [é˜²æ³„æ¼å®è·µ](#5-é˜²æ³„æ¼å®è·µ)
6. [ç­¾åä¸åŠ å¯†åˆ†ç¦»](#6-ç­¾åä¸åŠ å¯†åˆ†ç¦»)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å¯†é’¥ä¸æœºå¯†ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¯†é’¥ä¸æœºå¯†ç®¡ç†


**ğŸ’¡ ç®€å•ç†è§£**
```
æƒ³è±¡ä¸€ä¸‹ä½ çš„å®¶ï¼š
- ğŸ  æˆ¿é—¨é’¥åŒ™ = JWTç­¾åå¯†é’¥
- ğŸ” ä¿é™©ç®±å¯†ç  = æ•°æ®åº“å¯†ç 
- ğŸ“± æ‰‹æœºè§£é”ç  = APIè®¿é—®ä»¤ç‰Œ

åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å„ç§"é’¥åŒ™"å’Œ"å¯†ç "
å¯†é’¥ç®¡ç†å°±æ˜¯ç»Ÿä¸€ç®¡ç†è¿™äº›æ•æ„Ÿä¿¡æ¯çš„ç³»ç»Ÿ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¯†é’¥ç®¡ç†


**ğŸš¨ æ²¡æœ‰å¯†é’¥ç®¡ç†çš„é—®é¢˜**
```
ä¼ ç»Ÿåšæ³•çš„ç—›ç‚¹ï¼š
âŒ ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ â†’ ä»£ç æ³„éœ²å°±å…¨å®Œäº†
âŒ å†™åœ¨é…ç½®æ–‡ä»¶é‡Œ â†’ é…ç½®æ–‡ä»¶åˆ°å¤„ä¼ æ’­
âŒ ç¯å¢ƒå˜é‡æ˜æ–‡ â†’ è¿›ç¨‹æŸ¥çœ‹å°±èƒ½çœ‹åˆ°
âŒ æ‰‹å·¥ç®¡ç†æ›´æ–° â†’ äººå·¥æ“ä½œå®¹æ˜“å‡ºé”™

å¾®æœåŠ¡ç¯å¢ƒæ›´å¤æ‚ï¼š
- æœåŠ¡æ•°é‡å¤š â†’ å¯†é’¥ç®¡ç†æ›´å¤æ‚
- åŠ¨æ€éƒ¨ç½² â†’ å¯†é’¥éœ€è¦åŠ¨æ€è·å–
- å®¹å™¨åŒ–éƒ¨ç½² â†’ ä¼ ç»Ÿæ–‡ä»¶æ–¹å¼ä¸é€‚ç”¨
```

### 1.3 å¯†é’¥ç®¡ç†è¦è§£å†³ä»€ä¹ˆé—®é¢˜


**ğŸ¯ æ ¸å¿ƒç›®æ ‡**
```
ğŸ”¸ é›†ä¸­ç®¡ç†ï¼šç»Ÿä¸€å­˜å‚¨æ‰€æœ‰å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯
ğŸ”¸ å®‰å…¨å­˜å‚¨ï¼šåŠ å¯†ä¿å­˜ï¼Œé˜²æ­¢æ˜æ–‡æ³„éœ²
ğŸ”¸ åŠ¨æ€è·å–ï¼šæœåŠ¡å¯åŠ¨æ—¶åŠ¨æ€è·å–æ‰€éœ€å¯†é’¥
ğŸ”¸ æƒé™æ§åˆ¶ï¼šä¸åŒæœåŠ¡åªèƒ½è®¿é—®æˆæƒçš„å¯†é’¥
ğŸ”¸ å®¡è®¡è¿½è¸ªï¼šè®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™è®¿é—®äº†ä»€ä¹ˆå¯†é’¥
ğŸ”¸ è‡ªåŠ¨è½®æ¢ï¼šå®šæœŸæ›´æ¢å¯†é’¥ï¼Œå‡å°‘æ³„éœ²é£é™©
```

---

## 2. ğŸ¢ å¯†é’¥æ¥æºç®¡ç†


### 2.1 KMS/HSM ç¡¬ä»¶å®‰å…¨æ¨¡å—


**ğŸ”§ ä»€ä¹ˆæ˜¯KMS/HSM**
```
KMS (Key Management Service)ï¼š
- å°±åƒé“¶è¡Œçš„ä¿é™©åº“ç®¡ç†ç³»ç»Ÿ
- ä¸“é—¨ç”¨æ¥ç”Ÿæˆã€å­˜å‚¨ã€ç®¡ç†åŠ å¯†å¯†é’¥
- æä¾›APIè®©ä½ å®‰å…¨åœ°ä½¿ç”¨å¯†é’¥ï¼Œä½†ä¸èƒ½ç›´æ¥æ‹¿èµ°å¯†é’¥

HSM (Hardware Security Module)ï¼š
- å°±åƒä¸“ç”¨çš„ç¡¬ä»¶ä¿é™©ç®±
- ç”¨ä¸“é—¨çš„ç¡¬ä»¶èŠ¯ç‰‡æ¥ä¿æŠ¤å¯†é’¥
- å³ä½¿ç‰©ç†æ”»å‡»ä¹Ÿå¾ˆéš¾ç ´è§£
```

**ğŸ’¼ å®é™…åº”ç”¨åœºæ™¯**
```javascript
// ä½¿ç”¨AWS KMSçš„ä¾‹å­
const AWS = require('aws-sdk');
const kms = new AWS.KMS();

// åŠ å¯†æ•°æ®ï¼ˆä¸éœ€è¦çŸ¥é“å…·ä½“å¯†é’¥å†…å®¹ï¼‰
const encryptData = async (plaintext) => {
  const params = {
    KeyId: 'arn:aws:kms:us-east-1:123456789:key/12345678',  // å¯†é’¥ID
    Plaintext: plaintext
  };
  
  const result = await kms.encrypt(params).promise();
  return result.CiphertextBlob;  // è¿”å›åŠ å¯†åçš„æ•°æ®
};

// è§£å¯†æ•°æ®ï¼ˆKMSè‡ªåŠ¨è¯†åˆ«ç”¨å“ªä¸ªå¯†é’¥ï¼‰
const decryptData = async (ciphertext) => {
  const params = { CiphertextBlob: ciphertext };
  const result = await kms.decrypt(params).promise();
  return result.Plaintext.toString();
};
```

### 2.2 HashiCorp Vault


**ğŸ” Vaultæ˜¯ä»€ä¹ˆ**
```
å¯ä»¥ç†è§£ä¸ºï¼š
- ä¸€ä¸ªä¸“ä¸šçš„"å¯†ç ç®¡å®¶"è½¯ä»¶
- ä¸ä»…å­˜å‚¨å¯†é’¥ï¼Œè¿˜èƒ½ç”Ÿæˆä¸´æ—¶å¯†é’¥
- æ”¯æŒå¤šç§è®¤è¯æ–¹å¼å’Œå­˜å‚¨åç«¯
- å¼€æºï¼Œå¯ä»¥è‡ªå·±éƒ¨ç½²ç®¡ç†

Vaultçš„æ ¸å¿ƒç‰¹ç‚¹ï¼š
âœ… åŠ¨æ€å¯†é’¥ï¼šå¯ä»¥ç”Ÿæˆä¸´æ—¶çš„æ•°æ®åº“å¯†ç 
âœ… å¯†é’¥ç‰ˆæœ¬ï¼šæ”¯æŒå¯†é’¥çš„ç‰ˆæœ¬ç®¡ç†
âœ… å®¡è®¡æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰è®¿é—®æ“ä½œ
âœ… å¤šç§åç«¯ï¼šæ”¯æŒå„ç§æ•°æ®åº“å’ŒæœåŠ¡
```

**ğŸ› ï¸ Vaultä½¿ç”¨ç¤ºä¾‹**
```bash
# 1. å¯åŠ¨VaultæœåŠ¡
vault server -dev

# 2. è®¾ç½®ç¯å¢ƒå˜é‡
export VAULT_ADDR='http://127.0.0.1:8200'
export VAULT_TOKEN="dev-token"

# 3. å­˜å‚¨å¯†é’¥
vault kv put secret/myapp/db \
  username="dbuser" \
  password="supersecret"

# 4. è¯»å–å¯†é’¥
vault kv get secret/myapp/db

# 5. åœ¨åº”ç”¨ä¸­ä½¿ç”¨
```

```javascript
// Node.jsåº”ç”¨ä¸­ä½¿ç”¨Vault
const vault = require("node-vault")({
  endpoint: 'http://127.0.0.1:8200',
  token: process.env.VAULT_TOKEN
});

// è·å–æ•°æ®åº“å¯†ç 
const getDBCredentials = async () => {
  const result = await vault.read('secret/data/myapp/db');
  return {
    username: result.data.data.username,
    password: result.data.data.password
  };
};
```

### 2.3 äº‘å‚å•†KMSå¯¹æ¯”


| äº‘å‚å•† | æœåŠ¡åç§° | **ä¸»è¦ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|-------|---------|-------------|-------------|
| ğŸŒŸ **AWS** | `KMS` | `æ‰˜ç®¡æœåŠ¡ï¼Œä¸AWSæœåŠ¡æ·±åº¦é›†æˆ` | `AWSç”Ÿæ€é¡¹ç›®` |
| â˜ï¸ **Azure** | `Key Vault` | `æ”¯æŒå¯†é’¥ã€è¯ä¹¦ã€æœºå¯†ç»Ÿä¸€ç®¡ç†` | `æ··åˆäº‘ç¯å¢ƒ` |
| ğŸ”µ **é˜¿é‡Œäº‘** | `KMS` | `å›½äº§åŒ–ï¼Œåˆè§„æ€§å¥½` | `å›½å†…é¡¹ç›®` |
| ğŸŸ¢ **è…¾è®¯äº‘** | `KMS` | `æ¸¸æˆè¡Œä¸šä¼˜åŒ–` | `æ¸¸æˆå’Œç¤¾äº¤åº”ç”¨` |

**ğŸ¯ é€‰æ‹©å»ºè®®**
```
é€‰æ‹©KMSçš„è€ƒè™‘å› ç´ ï¼š

ğŸ”¸ æˆæœ¬è€ƒè™‘ï¼š
- äº‘å‚å•†KMSï¼šæŒ‰ä½¿ç”¨é‡ä»˜è´¹ï¼Œè¿ç»´æˆæœ¬ä½
- è‡ªå»ºVaultï¼šç¡¬ä»¶å’ŒäººåŠ›æˆæœ¬ï¼Œä½†é•¿æœŸä¾¿å®œ

ğŸ”¸ æŠ€æœ¯è¦æ±‚ï¼š
- å•äº‘ç¯å¢ƒ â†’ é€‰æ‹©å¯¹åº”äº‘å‚å•†KMS
- å¤šäº‘ç¯å¢ƒ â†’ è€ƒè™‘Vaultæˆ–HashiCorpäº‘æœåŠ¡
- æ··åˆäº‘ â†’ Vaultæ›´çµæ´»

ğŸ”¸ åˆè§„è¦æ±‚ï¼š
- å›½å†…é¡¹ç›® â†’ ä¼˜å…ˆè€ƒè™‘å›½äº§äº‘KMS
- é‡‘èè¡Œä¸š â†’ å¯èƒ½éœ€è¦HSMç¡¬ä»¶æ”¯æŒ
```

---

## 3. ğŸ”„ å¯†é’¥è½®æ¢ç­–ç•¥


### 3.1 ä»€ä¹ˆæ˜¯å¯†é’¥è½®æ¢


**ğŸ’¡ é€šä¿—ç†è§£**
```
å°±åƒä½ å®šæœŸæ¢é—¨é”ï¼š
- ğŸ  æ¬æ–°å®¶æ¢é” â†’ é˜²æ­¢å‰ç§Ÿæˆ·æœ‰é’¥åŒ™
- ğŸ” å‘˜å·¥ç¦»èŒæ¢é” â†’ é˜²æ­¢ç¦»èŒå‘˜å·¥è®¿é—®
- â° å®šæœŸæ¢é” â†’ å³ä½¿é’¥åŒ™ä¸¢äº†ä¹Ÿèƒ½åŠæ—¶æ­¢æŸ

å¯†é’¥è½®æ¢å°±æ˜¯å®šæœŸæ›´æ¢ç³»ç»Ÿä¸­çš„å¯†é’¥
ç¡®ä¿å³ä½¿æ—§å¯†é’¥æ³„éœ²ï¼Œå½±å“ä¹Ÿæ˜¯æœ‰é™çš„
```

### 3.2 å¤šç‰ˆæœ¬å¹¶è¡Œç®¡ç†


**ğŸ”¢ ç‰ˆæœ¬ç®¡ç†æœºåˆ¶**
```
å¯†é’¥ç‰ˆæœ¬ç®¡ç†å°±åƒè½¯ä»¶ç‰ˆæœ¬ï¼š

å½“å‰æ´»è·ƒå¯†é’¥ï¼šv3 (ç”¨äºç­¾åæ–°Token)
å†å²ç‰ˆæœ¬å¯†é’¥ï¼šv1, v2 (ç”¨äºéªŒè¯æ—§Token)

ä¸ºä»€ä¹ˆéœ€è¦å¤šç‰ˆæœ¬ï¼Ÿ
â“ å¦‚æœç«‹å³åºŸå¼ƒæ—§ç‰ˆæœ¬ä¼šæ€æ ·ï¼Ÿ
âœ… æ­£åœ¨ä½¿ç”¨çš„Tokenä¼šç«‹å³å¤±æ•ˆ
âœ… ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•
âœ… é€ æˆæœåŠ¡ä¸­æ–­

æ‰€ä»¥éœ€è¦æ¸è¿›å¼åˆ‡æ¢ï¼š
ç¬¬1é˜¶æ®µï¼šv3ç­¾åï¼Œv1/v2/v3éªŒè¯ â† æ–°æ—§å¹¶å­˜
ç¬¬2é˜¶æ®µï¼šv3ç­¾åï¼Œv2/v3éªŒè¯   â† é€æ­¥æ·˜æ±°
ç¬¬3é˜¶æ®µï¼šv3ç­¾åï¼Œv3éªŒè¯     â† å®Œå…¨åˆ‡æ¢
```

### 3.3 KID (Key ID) é€‰æ‹©æœºåˆ¶


**ğŸ·ï¸ KIDçš„ä½œç”¨**
```javascript
// JWT Headerä¸­çš„kidå­—æ®µ
{
  "alg": "RS256",
  "typ": "JWT",
  "kid": "key-2024-03"  â† è¿™å°±æ˜¯Key ID
}

// éªŒè¯æ—¶æ ¹æ®kidé€‰æ‹©å¯¹åº”å¯†é’¥
const verifyToken = (token) => {
  const header = JSON.parse(base64Decode(token.split('.')[0]));
  const kid = header.kid;
  
  // æ ¹æ®kidè·å–å¯¹åº”çš„å…¬é’¥
  const publicKey = getPublicKeyByKid(kid);
  return jwt.verify(token, publicKey);
};
```

**ğŸ”‘ KIDå‘½åç­–ç•¥**
```
å¸¸è§çš„KIDå‘½åè§„åˆ™ï¼š

æ—¶é—´ç­–ç•¥ï¼š
- key-2024-03-01  â† æŒ‰æ—¥æœŸ
- key-202403      â† æŒ‰æœˆä»½
- key-v1, key-v2  â† æŒ‰ç‰ˆæœ¬

ç¯å¢ƒç­–ç•¥ï¼š
- prod-key-v1     â† ç”Ÿäº§ç¯å¢ƒ
- test-key-v1     â† æµ‹è¯•ç¯å¢ƒ

ä¸šåŠ¡ç­–ç•¥ï¼š
- user-auth-v1    â† ç”¨æˆ·è®¤è¯
- api-sign-v1     â† APIç­¾å
```

### 3.4 ç°åº¦åˆ‡æ¢æµç¨‹


**ğŸ“ˆ ç°åº¦è½®æ¢æ­¥éª¤**
```
å®Œæ•´çš„å¯†é’¥è½®æ¢æµç¨‹ï¼š

é˜¶æ®µ1ï¼šå‡†å¤‡æ–°å¯†é’¥ (0% ä½¿ç”¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆæ–°å¯†é’¥v2     â”‚ â† ç”Ÿæˆä½†ä¸ä½¿ç”¨
â”‚ åˆ†å‘åˆ°å„æœåŠ¡     â”‚ â† ç¡®ä¿æ‰€æœ‰æœåŠ¡éƒ½æœ‰æ–°å¯†é’¥
â”‚ é…ç½®éªŒè¯æ”¯æŒ     â”‚ â† æ”¯æŒv1å’Œv2éªŒè¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2ï¼šå°èŒƒå›´è¯•ç”¨ (10% ä½¿ç”¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10%æ–°è¯·æ±‚ç”¨v2   â”‚ â† å°èŒƒå›´è¯•ç”¨æ–°å¯†é’¥
â”‚ 90%ç»§ç»­ç”¨v1     â”‚ â† å¤§éƒ¨åˆ†è¿˜ç”¨æ—§å¯†é’¥
â”‚ ç›‘æ§é”™è¯¯ç‡       â”‚ â† è§‚å¯Ÿæ˜¯å¦æœ‰é—®é¢˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ3ï¼šé€æ­¥æ‰©å¤§ (50% â†’ 100%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€æ­¥æé«˜v2ä½¿ç”¨ç‡ â”‚ â† æ²¡é—®é¢˜å°±æ‰©å¤§èŒƒå›´
â”‚ é™ä½v1ä½¿ç”¨ç‡     â”‚ â† å‡å°‘æ—§å¯†é’¥ä½¿ç”¨
â”‚ æŒç»­ç›‘æ§         â”‚ â† éšæ—¶å‡†å¤‡å›æ»š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ4ï¼šå®Œå…¨åˆ‡æ¢ (100% ä½¿ç”¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 100%ä½¿ç”¨v2      â”‚ â† æ–°å¯†é’¥å®Œå…¨æ¥ç®¡
â”‚ ä¿ç•™v1éªŒè¯      â”‚ â† æ—§Tokenä»èƒ½éªŒè¯
â”‚ ç­‰å¾…v1è¿‡æœŸ      â”‚ â† ç­‰æ—§Tokenè‡ªç„¶è¿‡æœŸ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ5ï¼šæ¸…ç†æ—§å¯†é’¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç§»é™¤v1éªŒè¯æ”¯æŒ   â”‚ â† æ—§Tokenä¸å†æœ‰æ•ˆ
â”‚ åˆ é™¤v1å¯†é’¥      â”‚ â† å®Œå…¨ç§»é™¤æ—§å¯†é’¥
â”‚ æ›´æ–°æ–‡æ¡£        â”‚ â† æ›´æ–°ç›¸å…³æ–‡æ¡£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ğŸ“¦ æœºå¯†åˆ†å‘æœºåˆ¶


### 4.1 Sidecar æ³¨å…¥æ¨¡å¼


**ğŸš— ä»€ä¹ˆæ˜¯Sidecaræ¨¡å¼**
```
æƒ³è±¡ä½ å¼€è½¦å‡ºé—¨ï¼š
- ğŸš— ä¸»è½¦ = ä½ çš„ä¸šåŠ¡åº”ç”¨
- ğŸï¸ è¾¹è½¦ = Sidecarå®¹å™¨
- è¾¹è½¦ä¸“é—¨è´Ÿè´£æ‹¿é’¥åŒ™å’ŒåŠ æ²¹
- ä¸»è½¦ä¸“å¿ƒå¼€è½¦ï¼Œä¸ç”¨ç®¡è¿™äº›æ‚äº‹

åœ¨Kubernetesä¸­ï¼š
Pod = ä¸»è½¦ + è¾¹è½¦
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Pod          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ä¸šåŠ¡å®¹å™¨       â”‚ â”‚ â† ä¸“æ³¨ä¸šåŠ¡é€»è¾‘
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Sidecarå®¹å™¨   â”‚ â”‚ â† ä¸“é—¨è·å–å¯†é’¥
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ› ï¸ Sidecarå®ç°ç¤ºä¾‹**
```yaml
# Kubernetes Deploymenté…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  template:
    spec:
      containers:
      # ä¸»ä¸šåŠ¡å®¹å™¨
      - name: app
        image: myapp:latest
        volumeMounts:
        - name: secrets
          mountPath: /etc/secrets
          
      # Sidecarå®¹å™¨ - è´Ÿè´£è·å–å¯†é’¥
      - name: secret-fetcher
        image: vault-sidecar:latest
        env:
        - name: VAULT_ADDR
          value: "https://vault.company.com"
        volumeMounts:
        - name: secrets
          mountPath: /etc/secrets
          
      volumes:
      - name: secrets
        emptyDir: {}
```

```javascript
// Sidecarå®¹å™¨çš„å¯†é’¥è·å–é€»è¾‘
const vault = require('node-vault')({
  endpoint: process.env.VAULT_ADDR,
  token: process.env.VAULT_TOKEN
});

const fetchSecrets = async () => {
  try {
    // ä»Vaultè·å–å¯†é’¥
    const dbSecret = await vault.read('secret/data/myapp/db');
    const jwtSecret = await vault.read('secret/data/myapp/jwt');
    
    // å†™å…¥å…±äº«æ–‡ä»¶
    fs.writeFileSync('/etc/secrets/db-password', 
      dbSecret.data.data.password);
    fs.writeFileSync('/etc/secrets/jwt-key', 
      jwtSecret.data.data.private_key);
      
    console.log('å¯†é’¥æ›´æ–°å®Œæˆ');
  } catch (error) {
    console.error('å¯†é’¥è·å–å¤±è´¥:', error);
  }
};

// å®šæœŸåˆ·æ–°å¯†é’¥
setInterval(fetchSecrets, 300000); // æ¯5åˆ†é’Ÿåˆ·æ–°
fetchSecrets(); // å¯åŠ¨æ—¶ç«‹å³è·å–
```

### 4.2 å®¹å™¨å¯†æ–‡æŒ‚è½½


**ğŸ’¾ æŒ‚è½½æ–¹å¼å¯¹æ¯”**
```
æ–¹å¼1ï¼šæ–‡ä»¶æŒ‚è½½
ä¼˜ç‚¹ï¼šâœ… ç®€å•ç›´æ¥ï¼Œåº”ç”¨æ— éœ€ä¿®æ”¹
ç¼ºç‚¹ï¼šâŒ æ–‡ä»¶æƒé™ç®¡ç†å¤æ‚

æ–¹å¼2ï¼šå†…å­˜æŒ‚è½½ (æ¨è)
ä¼˜ç‚¹ï¼šâœ… ä¸å†™å…¥ç£ç›˜ï¼Œæ›´å®‰å…¨
ç¼ºç‚¹ï¼šâŒ é‡å¯åä¸¢å¤±ï¼Œéœ€è¦é‡æ–°è·å–

æ–¹å¼3ï¼šç¯å¢ƒå˜é‡
ä¼˜ç‚¹ï¼šâœ… åº”ç”¨è·å–æ–¹ä¾¿
ç¼ºç‚¹ï¼šâŒ è¿›ç¨‹åˆ—è¡¨å¯è§ï¼Œä¸å¤Ÿå®‰å…¨
```

```yaml
# ä½¿ç”¨Kubernetes SecretæŒ‚è½½
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
type: Opaque
data:
  db-password: <base64ç¼–ç çš„å¯†ç >
  jwt-private-key: <base64ç¼–ç çš„ç§é’¥>

---
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      containers:
      - name: app
        image: myapp:latest
        volumeMounts:
        # æŒ‚è½½åˆ°å†…å­˜æ–‡ä»¶ç³»ç»Ÿ (æ¨è)
        - name: secret-volume
          mountPath: /etc/secrets
          readOnly: true
          
      volumes:
      - name: secret-volume
        secret:
          secretName: app-secrets
          defaultMode: 0400  # åªè¯»æƒé™
```

### 4.3 æœ€å°å¯è§åŸŸåŸåˆ™


**ğŸ¯ æƒé™æœ€å°åŒ–**
```
ä»€ä¹ˆæ˜¯æœ€å°å¯è§åŸŸï¼Ÿ
å°±åƒå…¬å¸çš„æœºå¯†æ–‡ä»¶ç®¡ç†ï¼š
- ğŸ’¼ æ€»ç»ç†ï¼šçœ‹å¾—åˆ°æ‰€æœ‰æœºå¯†
- ğŸ‘¨â€ğŸ’¼ éƒ¨é—¨ç»ç†ï¼šåªçœ‹å¾—åˆ°æœ¬éƒ¨é—¨æœºå¯†  
- ğŸ‘¨â€ğŸ’» æ™®é€šå‘˜å·¥ï¼šåªçœ‹å¾—åˆ°å·¥ä½œç›¸å…³æœºå¯†

å¾®æœåŠ¡ä¸­çš„åº”ç”¨ï¼š
æœåŠ¡Aï¼šåªèƒ½è®¿é—®Aéœ€è¦çš„å¯†é’¥
æœåŠ¡Bï¼šåªèƒ½è®¿é—®Béœ€è¦çš„å¯†é’¥
ç»ä¸ç»™è¶…å‡ºéœ€è¦çš„æƒé™
```

**ğŸ” æƒé™æ§åˆ¶å®ç°**
```javascript
// Vaultç­–ç•¥é…ç½®ç¤ºä¾‹
// user-serviceç­–ç•¥ï¼šåªèƒ½è®¿é—®ç”¨æˆ·ç›¸å…³å¯†é’¥
path "secret/data/user-service/*" {
  capabilities = ["read"]
}

// payment-serviceç­–ç•¥ï¼šåªèƒ½è®¿é—®æ”¯ä»˜ç›¸å…³å¯†é’¥
path "secret/data/payment-service/*" {
  capabilities = ["read"]
}
path "secret/data/encryption/payment-key" {
  capabilities = ["read"]
}

// åº”ç”¨ä¸­çš„æƒé™æ£€æŸ¥
const getSecret = async (serviceName, secretPath) => {
  // æ£€æŸ¥æœåŠ¡æ˜¯å¦æœ‰æƒé™è®¿é—®è¿™ä¸ªå¯†é’¥
  if (!hasPermission(serviceName, secretPath)) {
    throw new Error(`æœåŠ¡ ${serviceName} æ— æƒè®¿é—® ${secretPath}`);
  }
  
  return await vault.read(secretPath);
};
```

---

## 5. ğŸ›¡ï¸ é˜²æ³„æ¼å®è·µ


### 5.1 è„±æ•æ—¥å¿—


**ğŸ“ ä¸ºä»€ä¹ˆéœ€è¦è„±æ•**
```
å¸¸è§çš„å¯†é’¥æ³„æ¼åœºæ™¯ï¼š
âŒ é”™è¯¯æ—¥å¿—ï¼šæ‰“å°äº†åŒ…å«å¯†é’¥çš„å®Œæ•´è¯·æ±‚
âŒ è°ƒè¯•ä¿¡æ¯ï¼šå¼€å‘æ—¶è¾“å‡ºäº†æ•æ„Ÿé…ç½®
âŒ ç›‘æ§æ•°æ®ï¼šæ€§èƒ½ç›‘æ§åŒ…å«äº†æ•æ„Ÿå‚æ•°
âŒ é”™è¯¯æŠ¥å‘Šï¼šå¼‚å¸¸å †æ ˆåŒ…å«äº†å¯†é’¥ä¿¡æ¯

ç»“æœï¼šå¯†é’¥å‡ºç°åœ¨å„ç§æ—¥å¿—æ–‡ä»¶ä¸­
é£é™©ï¼šæ—¥å¿—æ–‡ä»¶é€šå¸¸æƒé™ç®¡ç†è¾ƒæ¾æ•£
```

**ğŸ” è„±æ•å®ç°æ–¹æ¡ˆ**
```javascript
// æ—¥å¿—è„±æ•å·¥å…·
class LogSanitizer {
  constructor() {
    this.sensitivePatterns = [
      /password["\s]*[:=]["\s]*([^",\s}]+)/gi,
      /token["\s]*[:=]["\s]*([^",\s}]+)/gi,
      /secret["\s]*[:=]["\s]*([^",\s}]+)/gi,
      /key["\s]*[:=]["\s]*([^",\s}]+)/gi,
      /Bearer\s+([a-zA-Z0-9\-_.]+)/gi
    ];
  }
  
  sanitize(message) {
    let cleaned = message;
    
    this.sensitivePatterns.forEach(pattern => {
      cleaned = cleaned.replace(pattern, (match, sensitive) => {
        // åªæ˜¾ç¤ºå‰3ä½å’Œå3ä½ï¼Œä¸­é—´ç”¨*ä»£æ›¿
        if (sensitive.length > 6) {
          return match.replace(sensitive, 
            sensitive.substring(0, 3) + '***' + 
            sensitive.substring(sensitive.length - 3));
        } else {
          return match.replace(sensitive, '***');
        }
      });
    });
    
    return cleaned;
  }
}

// ä½¿ç”¨è„±æ•æ—¥å¿—
const sanitizer = new LogSanitizer();
const logger = {
  info: (msg) => console.log(sanitizer.sanitize(msg)),
  error: (msg) => console.error(sanitizer.sanitize(msg))
};

// åŸå§‹æ—¥å¿—ï¼ˆå±é™©ï¼‰
// logger.info('ç”¨æˆ·ç™»å½•: {"username":"john","password":"secret123"}');

// è„±æ•åæ—¥å¿—ï¼ˆå®‰å…¨ï¼‰
// è¾“å‡º: ç”¨æˆ·ç™»å½•: {"username":"john","password":"sec***123"}
```

### 5.2 CI/CDæ‰«æ


**ğŸ” è‡ªåŠ¨åŒ–æ‰«ææœºåˆ¶**
```
CI/CD pipelineä¸­çš„å®‰å…¨æ£€æŸ¥ç‚¹ï¼š

ä»£ç æäº¤é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Git Hooks     â”‚ â† æäº¤æ—¶æ£€æŸ¥
â”‚   â”œâ”€ å¯†é’¥æ‰«æ    â”‚
â”‚   â”œâ”€ æ•æ„Ÿè¯æ£€æŸ¥  â”‚
â”‚   â””â”€ è§„åˆ™éªŒè¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
æ„å»ºé˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Build Stage   â”‚
â”‚   â”œâ”€ é™æ€ä»£ç æ‰«æ â”‚ â† SonarQubeç­‰
â”‚   â”œâ”€ ä¾èµ–å®‰å…¨æ£€æŸ¥ â”‚ â† æ£€æŸ¥ç¬¬ä¸‰æ–¹åº“
â”‚   â””â”€ å¯†é’¥æ³„æ¼æ£€æµ‹ â”‚ â† TruffleHogç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
éƒ¨ç½²å‰æ£€æŸ¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pre-Deploy     â”‚
â”‚  â”œâ”€ é…ç½®æ–‡ä»¶æ£€æŸ¥ â”‚
â”‚  â”œâ”€ ç¯å¢ƒå˜é‡æ£€æŸ¥ â”‚
â”‚  â””â”€ æƒé™éªŒè¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```yaml
# GitHub Actions å¯†é’¥æ‰«æç¤ºä¾‹
name: Security Scan
on: [push, pull_request]

jobs:
  secret-scan:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0  # æ‰«æå®Œæ•´å†å²
        
    # ä½¿ç”¨TruffleHogæ‰«æå¯†é’¥
    - name: Run TruffleHog
      uses: trufflesecurity/trufflehog@main
      with:
        path: ./
        base: main
        head: HEAD
        
    # è‡ªå®šä¹‰è§„åˆ™æ£€æŸ¥
    - name: Custom Secret Check
      run: |
        # æ£€æŸ¥æ˜¯å¦åŒ…å«æ˜æ–‡å¯†ç 
        if grep -r "password.*=" --include="*.js" --include="*.json" .; then
          echo "å‘ç°å¯èƒ½çš„æ˜æ–‡å¯†ç "
          exit 1
        fi
        
        # æ£€æŸ¥JWTå¯†é’¥
        if grep -r "jwt.*secret" --include="*.js" .; then
          echo "å‘ç°å¯èƒ½çš„JWTå¯†é’¥"
          exit 1
        fi
```

### 5.3 æœ€å°æƒé™IAM


**ğŸ‘¥ æƒé™åˆ†å±‚ç®¡ç†**
```
IAMæƒé™è®¾è®¡åŸåˆ™ï¼š

è§’è‰²åˆ†ç¦»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¼€å‘è€…è§’è‰²     â”‚ â† åªè¯»æƒé™ï¼Œçœ‹é…ç½®ä½†æ”¹ä¸äº†
â”‚   â”œâ”€ æŸ¥çœ‹å¯†é’¥åˆ—è¡¨ â”‚
â”‚   â”œâ”€ è¯»å–æµ‹è¯•ç¯å¢ƒ â”‚
â”‚   â””â”€ ç¦æ­¢ç”Ÿäº§ç¯å¢ƒ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿ç»´è§’è‰²      â”‚ â† éƒ¨ç½²æƒé™ï¼Œèƒ½æ›´æ–°ä½†ä¸èƒ½æŸ¥çœ‹
â”‚   â”œâ”€ æ›´æ–°å¯†é’¥    â”‚
â”‚   â”œâ”€ éƒ¨ç½²åº”ç”¨    â”‚
â”‚   â””â”€ ç›‘æ§å‘Šè­¦    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®‰å…¨ç®¡ç†å‘˜     â”‚ â† å®Œæ•´æƒé™ï¼Œä½†éœ€è¦å®¡æ‰¹
â”‚   â”œâ”€ æ‰€æœ‰æ“ä½œæƒé™ â”‚
â”‚   â”œâ”€ å®¡è®¡æ—¥å¿—     â”‚
â”‚   â””â”€ æƒé™ç®¡ç†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// IAMç­–ç•¥é…ç½®ç¤ºä¾‹ï¼ˆä»¥AWS IAMä¸ºä¾‹ï¼‰
const iamPolicy = {
  // å¼€å‘è€…ç­–ç•¥ï¼šåªèƒ½åœ¨å¼€å‘ç¯å¢ƒæ“ä½œ
  "DeveloperPolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": [
          "kms:Decrypt",
          "kms:DescribeKey"
        ],
        "Resource": "arn:aws:kms:*:*:key/*",
        "Condition": {
          "StringEquals": {
            "kms:ViaService": "secretsmanager.*.amazonaws.com"
          },
          "StringLike": {
            "secretsmanager:Name": "dev/*"  // åªèƒ½è®¿é—®devå¼€å¤´çš„å¯†é’¥
          }
        }
      }
    ]
  },
  
  // ç”Ÿäº§ç¯å¢ƒç­–ç•¥ï¼šä¸¥æ ¼é™åˆ¶
  "ProductionPolicy": {
    "Version": "2012-10-17", 
    "Statement": [
      {
        "Effect": "Allow",
        "Action": ["kms:Decrypt"],
        "Resource": "arn:aws:kms:*:*:key/prod-*",
        "Condition": {
          "IpAddress": {
            "aws:SourceIp": "10.0.0.0/16"  // åªèƒ½ä»å†…ç½‘è®¿é—®
          },
          "DateGreaterThan": {
            "aws:TokenIssueTime": "2024-01-01T00:00:00Z"
          }
        }
      }
    ]
  }
};
```

---

## 6. ğŸ”’ ç­¾åä¸åŠ å¯†åˆ†ç¦»


### 6.1 ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ç­¾åå’ŒåŠ å¯†


**ğŸ’¡ é€šä¿—ç†è§£**
```
æƒ³è±¡ä½ æœ‰ä¸¤æŠŠä¸åŒç”¨é€”çš„é’¥åŒ™ï¼š

ğŸ”‘ ç­¾åé’¥åŒ™ (ç§ç« )ï¼š
- ç”¨æ¥è¯æ˜"è¿™æ˜¯æˆ‘å†™çš„"
- åˆ«äººç”¨å…¬ç« éªŒè¯æ˜¯ä½ å†™çš„
- é‡ç‚¹æ˜¯è¯æ˜èº«ä»½å’Œå®Œæ•´æ€§

ğŸ” åŠ å¯†é’¥åŒ™ (ä¿é™©ç®±)ï¼š
- ç”¨æ¥ä¿æŠ¤å†…å®¹ä¸è¢«çœ‹åˆ°
- åªæœ‰æœ‰é’¥åŒ™çš„äººæ‰èƒ½çœ‹å†…å®¹
- é‡ç‚¹æ˜¯ä¿æŠ¤å†…å®¹éšç§

åˆ†å¼€ç®¡ç†çš„å¥½å¤„ï¼š
- ç­¾åé’¥åŒ™ä¸¢äº†ï¼šå½±å“èº«ä»½éªŒè¯ï¼Œä½†æ•°æ®è¿˜æ˜¯å®‰å…¨çš„
- åŠ å¯†é’¥åŒ™ä¸¢äº†ï¼šå½±å“æ•°æ®å®‰å…¨ï¼Œä½†èº«ä»½ç³»ç»Ÿè¿˜èƒ½ç”¨
- èŒè´£åˆ†ç¦»ï¼šä¸åŒå›¢é˜Ÿç®¡ç†ä¸åŒç±»å‹çš„é’¥åŒ™
```

### 6.2 ä¼ è¾“åŠ å¯†ä¸èº«ä»½ç­¾å


**ğŸ”„ ä¸åŒåœºæ™¯çš„å¯†é’¥éœ€æ±‚**
```
JWT Tokenç­¾ååœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç™»å½•       â”‚
â”‚   â†“             â”‚
â”‚   ç”ŸæˆJWT       â”‚ â† ç”¨ç­¾åå¯†é’¥
â”‚   â†“             â”‚
â”‚   è¿”å›ç»™å®¢æˆ·ç«¯   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

APIè°ƒç”¨éªŒè¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯è¯·æ±‚     â”‚
â”‚   â†“             â”‚
â”‚   éªŒè¯JWT       â”‚ â† ç”¨ç­¾åå…¬é’¥
â”‚   â†“             â”‚
â”‚   å…è®¸è®¿é—®       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®ä¼ è¾“åŠ å¯†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•æ„Ÿæ•°æ®       â”‚
â”‚   â†“             â”‚
â”‚   AESåŠ å¯†       â”‚ â† ç”¨ä¼ è¾“å¯†é’¥
â”‚   â†“             â”‚
â”‚   ç½‘ç»œä¼ è¾“       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®å­˜å‚¨åŠ å¯†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æ•°æ®       â”‚
â”‚   â†“             â”‚
â”‚   æ•°æ®åº“åŠ å¯†     â”‚ â† ç”¨å­˜å‚¨å¯†é’¥
â”‚   â†“             â”‚
â”‚   æŒä¹…åŒ–å­˜å‚¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 ä¸åŒåŸŸç®¡ç†å®ç°


**ğŸ¢ åˆ†åŸŸç®¡ç†æ¶æ„**
```javascript
// å¯†é’¥ç®¡ç†å™¨ - åˆ†åŸŸè®¾è®¡
class KeyManager {
  constructor() {
    this.domains = {
      // èº«ä»½è®¤è¯åŸŸ
      identity: {
        jwtSigningKey: null,      // JWTç­¾åç§é’¥
        jwtVerifyKey: null,       // JWTéªŒè¯å…¬é’¥
        refreshTokenKey: null,    // åˆ·æ–°ä»¤ç‰Œå¯†é’¥
        rotationPolicy: '30days'  // 30å¤©è½®æ¢
      },
      
      // æ•°æ®ä¼ è¾“åŸŸ  
      transport: {
        tlsPrivateKey: null,      // TLSç§é’¥
        tlsCertificate: null,     // TLSè¯ä¹¦
        apiEncryptionKey: null,   // APIåŠ å¯†å¯†é’¥
        rotationPolicy: '90days'  // 90å¤©è½®æ¢
      },
      
      // æ•°æ®å­˜å‚¨åŸŸ
      storage: {
        databaseKey: null,        // æ•°æ®åº“åŠ å¯†å¯†é’¥
        fileEncryptionKey: null,  // æ–‡ä»¶åŠ å¯†å¯†é’¥
        backupKey: null,          // å¤‡ä»½åŠ å¯†å¯†é’¥
        rotationPolicy: '365days' // 1å¹´è½®æ¢
      }
    };
  }
  
  // æ ¹æ®ç”¨é€”è·å–å¯¹åº”å¯†é’¥
  getKeyForPurpose(purpose) {
    switch(purpose) {
      case 'jwt-sign':
        return this.domains.identity.jwtSigningKey;
      case 'jwt-verify':
        return this.domains.identity.jwtVerifyKey;
      case 'data-encrypt':
        return this.domains.storage.databaseKey;
      case 'transport-encrypt':
        return this.domains.transport.apiEncryptionKey;
      default:
        throw new Error(`æœªçŸ¥çš„å¯†é’¥ç”¨é€”: ${purpose}`);
    }
  }
}
```

**ğŸ” å®é™…ä½¿ç”¨ç¤ºä¾‹**
```javascript
// JWTæœåŠ¡ - åªä½¿ç”¨èº«ä»½åŸŸå¯†é’¥
class JWTService {
  constructor(keyManager) {
    this.signingKey = keyManager.getKeyForPurpose('jwt-sign');
    this.verifyKey = keyManager.getKeyForPurpose('jwt-verify');
  }
  
  generateToken(payload) {
    return jwt.sign(payload, this.signingKey, {
      algorithm: 'RS256',
      expiresIn: '1h'
    });
  }
  
  verifyToken(token) {
    return jwt.verify(token, this.verifyKey, {
      algorithms: ['RS256']
    });
  }
}

// æ•°æ®åŠ å¯†æœåŠ¡ - åªä½¿ç”¨å­˜å‚¨åŸŸå¯†é’¥
class DataEncryptionService {
  constructor(keyManager) {
    this.encryptionKey = keyManager.getKeyForPurpose('data-encrypt');
  }
  
  encrypt(data) {
    const cipher = crypto.createCipher('aes-256-gcm', this.encryptionKey);
    let encrypted = cipher.update(data, 'utf8', 'hex');
    encrypted += cipher.final('hex');
    return encrypted;
  }
  
  decrypt(encryptedData) {
    const decipher = crypto.createDecipher('aes-256-gcm', this.encryptionKey);
    let decrypted = decipher.update(encryptedData, 'hex', 'utf8');
    decrypted += decipher.final('utf8');
    return decrypted;
  }
}
```

**ğŸ›¡ï¸ å®‰å…¨éš”ç¦»é…ç½®**
```yaml
# Kubernetesä¸­çš„å¯†é’¥åˆ†åŸŸç®¡ç†
apiVersion: v1
kind: Secret
metadata:
  name: identity-keys
  namespace: auth-service
type: Opaque
data:
  jwt-private-key: <base64ç¼–ç >
  jwt-public-key: <base64ç¼–ç >

---
apiVersion: v1
kind: Secret
metadata:
  name: storage-keys
  namespace: data-service  # ä¸åŒçš„å‘½åç©ºé—´
type: Opaque
data:
  db-encryption-key: <base64ç¼–ç >
  file-encryption-key: <base64ç¼–ç >

---
# RBACæƒé™é…ç½®
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: auth-service
  name: auth-service-role
rules:
- apiGroups: [""]
  resources: ["secrets"]
  resourceNames: ["identity-keys"]  # åªèƒ½è®¿é—®èº«ä»½åŸŸå¯†é’¥
  verbs: ["get", "list"]
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¯†é’¥ç®¡ç†æœ¬è´¨ï¼šç»Ÿä¸€ã€å®‰å…¨ã€åŠ¨æ€åœ°ç®¡ç†æ‰€æœ‰æ•æ„Ÿä¿¡æ¯
ğŸ”¸ å¯†é’¥æ¥æºé€‰æ‹©ï¼šKMS/HSMä¸“ä¸šçº§ï¼ŒVaulté€šç”¨çº§ï¼Œäº‘å‚å•†æ‰˜ç®¡çº§
ğŸ”¸ è½®æ¢ç­–ç•¥ï¼šå¤šç‰ˆæœ¬å¹¶è¡Œï¼Œkidé€‰æ‹©ï¼Œç°åº¦åˆ‡æ¢ï¼Œç¡®ä¿å¹³æ»‘è¿‡æ¸¡
ğŸ”¸ åˆ†å‘æœºåˆ¶ï¼šSidecarä¸“èŒï¼Œå®¹å™¨æŒ‚è½½ï¼Œæœ€å°æƒé™ï¼ŒèŒè´£åˆ†ç¦»
ğŸ”¸ é˜²æ³„æ¼å®è·µï¼šè„±æ•æ—¥å¿—ï¼ŒCI/CDæ‰«æï¼ŒIAMæƒé™ï¼Œå…¨æ–¹ä½é˜²æŠ¤
ğŸ”¸ ç­¾ååŠ å¯†åˆ†ç¦»ï¼šä¸åŒç”¨é€”ä¸åŒå¯†é’¥ï¼Œåˆ†åŸŸç®¡ç†ï¼Œé™ä½é£é™©
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆå¯†é’¥ç®¡ç†è¿™ä¹ˆé‡è¦**
```
å¾®æœåŠ¡æ¶æ„çš„æŒ‘æˆ˜ï¼š
- æœåŠ¡æ•°é‡å¤š â†’ å¯†é’¥ç®¡ç†å¤æ‚åº¦æŒ‡æ•°çº§å¢é•¿
- åŠ¨æ€éƒ¨ç½² â†’ ä¼ ç»Ÿæ–‡ä»¶ç®¡ç†æ–¹å¼ä¸é€‚ç”¨
- å®‰å…¨è¦æ±‚é«˜ â†’ ä¸€ä¸ªå¯†é’¥æ³„éœ²å¯èƒ½å½±å“æ•´ä¸ªç³»ç»Ÿ
- åˆè§„è¦æ±‚ â†’ éœ€è¦å®Œæ•´çš„å®¡è®¡å’Œæƒé™ç®¡ç†

å¯†é’¥ç®¡ç†è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š
é›†ä¸­åŒ– + è‡ªåŠ¨åŒ– + å®‰å…¨åŒ– = å¯ç®¡ç†çš„å¾®æœåŠ¡å®‰å…¨
```

**ğŸ”¹ è½®æ¢ç­–ç•¥çš„æ ¸å¿ƒæ€æƒ³**
```
å¹³è¡¡å®‰å…¨æ€§ä¸å¯ç”¨æ€§ï¼š
å®‰å…¨æ€§è¦æ±‚ï¼šå¯†é’¥è¦ç»å¸¸æ¢ï¼Œå‡å°‘æ³„éœ²å½±å“
å¯ç”¨æ€§è¦æ±‚ï¼šä¸èƒ½å› ä¸ºæ¢å¯†é’¥å¯¼è‡´æœåŠ¡ä¸­æ–­

è§£å†³æ–¹æ¡ˆï¼š
å¤šç‰ˆæœ¬å¹¶è¡Œ + æ¸è¿›å¼åˆ‡æ¢ = å®‰å…¨ä¸”å¹³æ»‘çš„è½®æ¢
```

**ğŸ”¹ åˆ†ç¦»ç®¡ç†çš„ä»·å€¼**
```
èŒè´£åˆ†ç¦»çš„å¥½å¤„ï¼š
- é™ä½å•ç‚¹é£é™©ï¼šä¸€ç§å¯†é’¥æ³„éœ²ä¸å½±å“å…¶ä»–åŠŸèƒ½
- ç®€åŒ–æƒé™ç®¡ç†ï¼šä¸åŒå›¢é˜Ÿç®¡ç†ä¸åŒç±»å‹å¯†é’¥
- ä¼˜åŒ–è½®æ¢ç­–ç•¥ï¼šä¸åŒç”¨é€”æœ‰ä¸åŒçš„è½®æ¢å‘¨æœŸ
- æé«˜ç³»ç»Ÿå¼¹æ€§ï¼šéƒ¨åˆ†åŠŸèƒ½å—å½±å“ï¼Œå…¶ä»–åŠŸèƒ½ç»§ç»­å·¥ä½œ
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ é€‰æ‹©å¯†é’¥ç®¡ç†æ–¹æ¡ˆ**
```
å°å‹é¡¹ç›®ï¼ˆ< 10ä¸ªæœåŠ¡ï¼‰ï¼š
âœ… äº‘å‚å•†KMS + Kubernetes Secret
âœ… æˆæœ¬ä½ï¼Œè¿ç»´ç®€å•

ä¸­å‹é¡¹ç›®ï¼ˆ10-50ä¸ªæœåŠ¡ï¼‰ï¼š
âœ… Vault + Sidecaræ¨¡å¼
âœ… çµæ´»æ€§å¥½ï¼ŒåŠŸèƒ½å®Œæ•´

å¤§å‹é¡¹ç›®ï¼ˆ> 50ä¸ªæœåŠ¡ï¼‰ï¼š
âœ… ä¼ä¸šçº§KMS + å¤šäº‘ç®¡ç†
âœ… ä¸“ä¸šæ–¹æ¡ˆï¼Œåˆè§„å®Œæ•´
```

**ğŸ› ï¸ å®æ–½å»ºè®®**
```
åˆ†é˜¶æ®µå®æ–½ç­–ç•¥ï¼š

ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®‰å…¨
- ç§»é™¤ä»£ç ä¸­çš„ç¡¬ç¼–ç å¯†é’¥
- ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶
- å®æ–½åŸºæœ¬çš„è®¿é—®æ§åˆ¶

ç¬¬äºŒé˜¶æ®µï¼šé›†ä¸­ç®¡ç†  
- å¼•å…¥Vaultæˆ–äº‘KMS
- å®æ–½Sidecaræ¨¡å¼
- å»ºç«‹å¯†é’¥è½®æ¢æœºåˆ¶

ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§å®‰å…¨
- å®æ–½åˆ†åŸŸç®¡ç†
- å®Œå–„é˜²æ³„æ¼æœºåˆ¶
- å»ºç«‹å®‰å…¨å®¡è®¡ä½“ç³»

è®°ä½ï¼šå®‰å…¨æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ï¼Œä¸è¦è¯•å›¾ä¸€æ­¥åˆ°ä½
```

### 7.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ æ€§èƒ½é—®é¢˜**
```
é—®é¢˜ï¼šæ¯æ¬¡éƒ½ä»Vaultè·å–å¯†é’¥ï¼Œæ€§èƒ½å¤ªæ…¢
è§£å†³ï¼šæœ¬åœ°ç¼“å­˜ + å®šæœŸåˆ·æ–° + å¤±æ•ˆé‡è¯•

é—®é¢˜ï¼šå¯†é’¥è½®æ¢æ—¶æœåŠ¡é‡å¯ï¼Œå½±å“å¯ç”¨æ€§  
è§£å†³ï¼šçƒ­æ›´æ–°æœºåˆ¶ + å¤šç‰ˆæœ¬æ”¯æŒ + ç°åº¦åˆ‡æ¢
```

**â“ è¿ç»´é—®é¢˜**
```
é—®é¢˜ï¼šå¯†é’¥ç®¡ç†ç³»ç»Ÿæœ¬èº«æˆä¸ºå•ç‚¹æ•…éšœ
è§£å†³ï¼šVaulté›†ç¾¤ + å¤šå¯ç”¨åŒºéƒ¨ç½² + è‡ªåŠ¨æ•…éšœè½¬ç§»

é—®é¢˜ï¼šå¼€å‘äººå‘˜æ— æ³•è°ƒè¯•ï¼Œå› ä¸ºçœ‹ä¸åˆ°å¯†é’¥
è§£å†³ï¼šåˆ†ç¯å¢ƒç®¡ç† + å¼€å‘ç¯å¢ƒé™çº§ + è„±æ•å·¥å…·
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¯†é’¥ç®¡ç†æ˜¯å¾®æœåŠ¡å®‰å…¨çš„åŸºçŸ³ï¼Œå¿…é¡»ä»æ¶æ„å±‚é¢ç»Ÿä¸€è§„åˆ’
- å®‰å…¨æ€§ä¸ä¾¿åˆ©æ€§éœ€è¦å¹³è¡¡ï¼Œè¿‡åº¦å¤æ‚ä¼šå½±å“å¼€å‘æ•ˆç‡
- åˆ†åŸŸç®¡ç†é™ä½é£é™©ï¼Œè‡ªåŠ¨åŒ–è¿ç»´æé«˜æ•ˆç‡
- é˜²æ³„æ¼éœ€è¦å…¨æ–¹ä½é˜²æŠ¤ï¼ŒæŠ€æœ¯æ‰‹æ®µä¸ç®¡ç†åˆ¶åº¦å¹¶é‡