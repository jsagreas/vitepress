---
title: 2ã€ç»Ÿä¸€è®¤è¯ç½‘å…³
---
## ğŸ“š ç›®å½•

1. [ç»Ÿä¸€è®¤è¯ç½‘å…³æ¦‚è¿°](#1-ç»Ÿä¸€è®¤è¯ç½‘å…³æ¦‚è¿°)
2. [ç½‘å…³ç»Ÿä¸€è®¤è¯æ¶æ„](#2-ç½‘å…³ç»Ÿä¸€è®¤è¯æ¶æ„)
3. [JWTåœ¨å¾®æœåŠ¡ä¸­çš„ä¼ æ’­](#3-JWTåœ¨å¾®æœåŠ¡ä¸­çš„ä¼ æ’­)
4. [ç½‘å…³èŒè´£ä¸è¾¹ç•Œ](#4-ç½‘å…³èŒè´£ä¸è¾¹ç•Œ)
5. [ä»¤ç‰Œæ ¡éªŒç­–ç•¥](#5-ä»¤ç‰Œæ ¡éªŒç­–ç•¥)
6. [æƒé™æ§åˆ¶ä¸è·¯ç”±](#6-æƒé™æ§åˆ¶ä¸è·¯ç”±)
7. [è®¤è¯å¤±è´¥å¤„ç†](#7-è®¤è¯å¤±è´¥å¤„ç†)
8. [è·¨åŸŸè®¤è¯ç­–ç•¥](#8-è·¨åŸŸè®¤è¯ç­–ç•¥)
9. [ç”¨æˆ·ä¸Šä¸‹æ–‡ä¼ é€’](#9-ç”¨æˆ·ä¸Šä¸‹æ–‡ä¼ é€’)
10. [é™æµä¸ç†”æ–­](#10-é™æµä¸ç†”æ–­)
11. [å¤šç§Ÿæˆ·å…¥å£éš”ç¦»](#11-å¤šç§Ÿæˆ·å…¥å£éš”ç¦»)
12. [ä¸»æµç½‘å…³å¯¹æ¯”](#12-ä¸»æµç½‘å…³å¯¹æ¯”)
13. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#13-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ç»Ÿä¸€è®¤è¯ç½‘å…³æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç»Ÿä¸€è®¤è¯ç½‘å…³


> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šç»Ÿä¸€è®¤è¯ç½‘å…³å°±åƒä¼ä¸šå¤§æ¥¼çš„é—¨å«ï¼Œæ‰€æœ‰äººè¿›å…¥éƒ½è¦åœ¨é—¨å£éªŒè¯èº«ä»½ï¼ŒéªŒè¯é€šè¿‡åæ‰èƒ½è¿›å…¥å†…éƒ¨å„ä¸ªéƒ¨é—¨åŠäº‹ã€‚

**é€šä¿—è§£é‡Š**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼ˆæ²¡æœ‰ç½‘å…³ï¼‰ï¼š
ç”¨æˆ· â†’ è®¢å•æœåŠ¡ï¼ˆéœ€è¦éªŒè¯ï¼‰ âŒ
ç”¨æˆ· â†’ ç”¨æˆ·æœåŠ¡ï¼ˆéœ€è¦éªŒè¯ï¼‰ âŒ  
ç”¨æˆ· â†’ æ”¯ä»˜æœåŠ¡ï¼ˆéœ€è¦éªŒè¯ï¼‰ âŒ
æ¯ä¸ªæœåŠ¡éƒ½è¦è‡ªå·±éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé‡å¤å·¥ä½œ

ç»Ÿä¸€ç½‘å…³æ–¹å¼ï¼š
ç”¨æˆ· â†’ ç½‘å…³ï¼ˆç»Ÿä¸€éªŒè¯ï¼‰â†’ å„ä¸ªæœåŠ¡ âœ…
åªéœ€è¦åœ¨ç½‘å…³éªŒè¯ä¸€æ¬¡ï¼Œå†…éƒ¨æœåŠ¡ç›´æ¥ä¿¡ä»»
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€è®¤è¯ç½‘å…³


**ğŸ”¸ è§£å†³çš„é—®é¢˜**ï¼š
- **é‡å¤è®¤è¯**ï¼šæ¯ä¸ªå¾®æœåŠ¡éƒ½è¦å†™è®¤è¯é€»è¾‘
- **å®‰å…¨é£é™©**ï¼šå†…éƒ¨æœåŠ¡ç›´æ¥æš´éœ²ç»™å¤–ç½‘
- **ç®¡ç†æ··ä¹±**ï¼šè®¤è¯é€»è¾‘åˆ†æ•£ï¼Œéš¾ä»¥ç»´æŠ¤
- **æ€§èƒ½æŸè€—**ï¼šæ¯ä¸ªæœåŠ¡éƒ½è¦éªŒè¯JWTï¼Œèµ„æºæµªè´¹

**ğŸ”¸ å¸¦æ¥çš„å¥½å¤„**ï¼š
- **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰è¯·æ±‚éƒ½ä»ç½‘å…³è¿›å…¥
- **é›†ä¸­è®¤è¯**ï¼šè®¤è¯é€»è¾‘é›†ä¸­åœ¨ç½‘å…³
- **å®‰å…¨éš”ç¦»**ï¼šå†…éƒ¨æœåŠ¡ä¸ç›´æ¥æš´éœ²
- **æ˜“äºç®¡ç†**ï¼šç»Ÿä¸€çš„è®¤è¯ç­–ç•¥å’Œæ—¥å¿—

---

## 2. ğŸ—ï¸ ç½‘å…³ç»Ÿä¸€è®¤è¯æ¶æ„


### 2.1 æ•´ä½“æ¶æ„å›¾


```
                    äº’è”ç½‘ç”¨æˆ·
                        |
                   ã€APIç½‘å…³å±‚ã€‘
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  ç»Ÿä¸€è®¤è¯   â”‚
                  â”‚  æƒé™éªŒè¯   â”‚ â† JWTä»¤ç‰ŒéªŒè¯
                  â”‚  è·¯ç”±è½¬å‘   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        |
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           |            |            |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ç”¨æˆ·æœåŠ¡   â”‚ â”‚  è®¢å•æœåŠ¡   â”‚ â”‚  æ”¯ä»˜æœåŠ¡   â”‚
    â”‚ (å†…ç½‘å®‰å…¨)  â”‚ â”‚ (å†…ç½‘å®‰å…¨)  â”‚ â”‚ (å†…ç½‘å®‰å…¨)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è®¤è¯æµç¨‹


**æ­¥éª¤è§£æ**ï¼š
```
â‘  ç”¨æˆ·è¯·æ±‚ â†’ APIç½‘å…³
â‘¡ ç½‘å…³æå–JWTä»¤ç‰Œ
â‘¢ éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
â‘£ è§£æç”¨æˆ·æƒé™ä¿¡æ¯
â‘¤ æ£€æŸ¥æ¥å£è®¿é—®æƒé™
â‘¥ è½¬å‘è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡
â‘¦ è¿”å›å“åº”ç»™ç”¨æˆ·
```

### 2.3 Spring Cloud Gatewayé…ç½®ç¤ºä¾‹


```java
@Component
public class AuthGatewayFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        String path = request.getPath().toString();
        
        // è·³è¿‡ä¸éœ€è¦è®¤è¯çš„è·¯å¾„
        if (isWhitePath(path)) {
            return chain.filter(exchange);
        }
        
        // æå–JWTä»¤ç‰Œ
        String token = extractToken(request);
        if (token == null) {
            return unauthorizedResponse(exchange);
        }
        
        // éªŒè¯ä»¤ç‰Œ
        if (!validateToken(token)) {
            return unauthorizedResponse(exchange);
        }
        
        // æ·»åŠ ç”¨æˆ·ä¿¡æ¯åˆ°è¯·æ±‚å¤´
        ServerHttpRequest newRequest = request.mutate()
            .header("X-User-Id", getUserId(token))
            .header("X-User-Role", getUserRole(token))
            .build();
            
        return chain.filter(exchange.mutate().request(newRequest).build());
    }
}
```

---

## 3. ğŸ”„ JWTåœ¨å¾®æœåŠ¡ä¸­çš„ä¼ æ’­


### 3.1 JWTä¼ æ’­æœºåˆ¶


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒæ¥åŠ›èµ›è·‘ï¼ŒJWTä»¤ç‰Œåœ¨å„ä¸ªå¾®æœåŠ¡ä¹‹é—´ä¼ é€’ï¼Œæ¯ä¸ªæœåŠ¡éƒ½èƒ½çŸ¥é“"è¿™ä¸ªç”¨æˆ·æ˜¯è°ï¼Œæœ‰ä»€ä¹ˆæƒé™"ã€‚

### 3.2 ä¼ æ’­æ–¹å¼è¯¦è§£


**ğŸ”¸ Tokenç»§æ‰¿**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ ç½‘å…³ï¼ˆéªŒè¯JWTï¼‰â†’ æœåŠ¡Aï¼ˆä½¿ç”¨ç›¸åŒJWTï¼‰â†’ æœåŠ¡Bï¼ˆä½¿ç”¨ç›¸åŒJWTï¼‰
```

**ğŸ”¸ æƒé™ä¼ é€’**ï¼š
```java
// ç½‘å…³éªŒè¯åï¼Œå°†ç”¨æˆ·ä¿¡æ¯æ”¾å…¥è¯·æ±‚å¤´
@Component
public class JWTTransmissionFilter {
    
    public void addUserContext(ServerHttpRequest request, String jwt) {
        // è§£æJWTè·å–ç”¨æˆ·ä¿¡æ¯
        Claims claims = Jwts.parser()
            .setSigningKey(secret)
            .parseClaimsJws(jwt)
            .getBody();
            
        // æ·»åŠ åˆ°è¯·æ±‚å¤´ä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡
        request.mutate()
            .header("X-User-Id", claims.get("userId"))
            .header("X-User-Name", claims.get("username"))
            .header("X-User-Roles", claims.get("roles"))
            .build();
    }
}
```

### 3.3 é“¾å¼è°ƒç”¨ç¤ºä¾‹


```
è¯·æ±‚æµç¨‹ï¼š
å®¢æˆ·ç«¯ â†’ ç½‘å…³ â†’ è®¢å•æœåŠ¡ â†’ ç”¨æˆ·æœåŠ¡ â†’ æ”¯ä»˜æœåŠ¡

JWTä¼ æ’­ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç½‘å…³éªŒè¯   â”‚ â†’  â”‚  è®¢å•æœåŠ¡   â”‚ â†’  â”‚  ç”¨æˆ·æœåŠ¡   â”‚
â”‚ JWT: Valid  â”‚    â”‚ ç”¨æˆ·ID: 123 â”‚    â”‚ è§’è‰²: VIP   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ğŸ¯ ç½‘å…³èŒè´£ä¸è¾¹ç•Œ


### 4.1 ç½‘å…³æ ¸å¿ƒèŒè´£


**ğŸ”¸ ç»Ÿä¸€å…¥å£**ï¼š
- æ‰€æœ‰å¤–éƒ¨è¯·æ±‚çš„å”¯ä¸€å…¥å£
- éšè—å†…éƒ¨æœåŠ¡æ¶æ„å¤æ‚æ€§
- æä¾›ç»Ÿä¸€çš„APIç‰ˆæœ¬ç®¡ç†

**ğŸ”¸ ä»¤ç‰ŒéªŒè¯**ï¼š
```java
public class TokenValidator {
    
    public boolean validateJWT(String token) {
        try {
            // â‘  éªŒè¯ä»¤ç‰Œæ ¼å¼
            if (!isValidFormat(token)) return false;
            
            // â‘¡ éªŒè¯ç­¾å
            if (!isValidSignature(token)) return false;
            
            // â‘¢ éªŒè¯è¿‡æœŸæ—¶é—´
            if (isExpired(token)) return false;
            
            // â‘£ éªŒè¯æƒé™èŒƒå›´
            if (!hasValidScope(token)) return false;
            
            return true;
        } catch (Exception e) {
            return false;
        }
    }
}
```

**ğŸ”¸ è·¯ç”±è½¬å‘**ï¼š
```yaml
# application.yml
spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/api/orders/**
```

### 4.2 èŒè´£è¾¹ç•Œåˆ’åˆ†


| èŒè´£ç±»å‹ | **ç½‘å…³è´Ÿè´£** | **å¾®æœåŠ¡è´Ÿè´£** | **è¯´æ˜** |
|---------|-------------|--------------|---------|
| ğŸ” **èº«ä»½è®¤è¯** | `JWTä»¤ç‰ŒéªŒè¯` | `ä¸šåŠ¡æƒé™æ£€æŸ¥` | `ç½‘å…³éªŒè¯èº«ä»½ï¼ŒæœåŠ¡éªŒè¯å…·ä½“æƒé™` |
| ğŸ›¡ï¸ **å®‰å…¨é˜²æŠ¤** | `HTTPSã€é™æµã€é˜²ç«å¢™` | `ä¸šåŠ¡æ•°æ®éªŒè¯` | `ç½‘å…³è´Ÿè´£é€šç”¨å®‰å…¨ï¼ŒæœåŠ¡è´Ÿè´£ä¸šåŠ¡å®‰å…¨` |
| ğŸ“Š **ç›‘æ§æ—¥å¿—** | `è¯·æ±‚æ—¥å¿—ã€æ€§èƒ½ç›‘æ§` | `ä¸šåŠ¡æ—¥å¿—ã€é”™è¯¯è¿½è¸ª` | `ç½‘å…³ç›‘æ§æµé‡ï¼ŒæœåŠ¡ç›‘æ§ä¸šåŠ¡` |
| ğŸ”„ **æ•°æ®å¤„ç†** | `è¯·æ±‚è·¯ç”±ã€å¤´éƒ¨å¤„ç†` | `ä¸šåŠ¡é€»è¾‘ã€æ•°æ®æ“ä½œ` | `ç½‘å…³å¤„ç†ä¼ è¾“ï¼ŒæœåŠ¡å¤„ç†ä¸šåŠ¡` |

---

## 5. ğŸ” ä»¤ç‰Œæ ¡éªŒç­–ç•¥


### 5.1 ç¦»çº¿ vs åœ¨çº¿æ ¡éªŒ


**ğŸ”¸ ç¦»çº¿ä»¤ç‰Œæ ¡éªŒ**ï¼š
```
ä¼˜åŠ¿ï¼š
âœ… æ€§èƒ½é«˜ï¼šæœ¬åœ°éªŒè¯ï¼Œæ— éœ€ç½‘ç»œè¯·æ±‚
âœ… å¯ç”¨æ€§å¥½ï¼šä¸ä¾èµ–è®¤è¯æœåŠ¡
âœ… å»¶è¿Ÿä½ï¼šæ¯«ç§’çº§éªŒè¯

åŠ£åŠ¿ï¼š
âŒ æ— æ³•å®æ—¶æ’¤é”€
âŒ ä»¤ç‰Œè¾ƒå¤§ï¼šåŒ…å«ç”¨æˆ·ä¿¡æ¯
âŒ å¯†é’¥ç®¡ç†å¤æ‚
```

```java
// ç¦»çº¿æ ¡éªŒç¤ºä¾‹
@Service
public class OfflineTokenValidator {
    
    @Value("${jwt.secret}")
    private String jwtSecret;
    
    public boolean validate(String token) {
        try {
            Jwts.parser()
                .setSigningKey(jwtSecret)  // æœ¬åœ°å¯†é’¥éªŒè¯
                .parseClaimsJws(token);
            return true;
        } catch (JwtException e) {
            return false;
        }
    }
}
```

**ğŸ”¸ åœ¨çº¿ä»¤ç‰Œæ ¡éªŒ**ï¼š
```
ä¼˜åŠ¿ï¼š
âœ… å®æ—¶æ€§å¼ºï¼šå¯ç«‹å³æ’¤é”€ä»¤ç‰Œ
âœ… ä»¤ç‰Œè½»é‡ï¼šåªåŒ…å«æ ‡è¯†ä¿¡æ¯
âœ… å®‰å…¨æ€§é«˜ï¼šé›†ä¸­ç®¡æ§

åŠ£åŠ¿ï¼š
âŒ ç½‘ç»œä¾èµ–ï¼šéœ€è¦è°ƒç”¨è®¤è¯æœåŠ¡
âŒ æ€§èƒ½å¼€é”€ï¼šé¢å¤–çš„ç½‘ç»œè¯·æ±‚
âŒ å¯ç”¨æ€§é£é™©ï¼šè®¤è¯æœåŠ¡æ•…éšœå½±å“å…¨å±€
```

```java
// åœ¨çº¿æ ¡éªŒç¤ºä¾‹
@Service
public class OnlineTokenValidator {
    
    @Autowired
    private AuthServiceClient authClient;
    
    public boolean validate(String token) {
        try {
            // è°ƒç”¨è®¤è¯æœåŠ¡éªŒè¯
            TokenValidationResult result = authClient.validateToken(token);
            return result.isValid();
        } catch (Exception e) {
            return false;
        }
    }
}
```

### 5.2 æ··åˆæ ¡éªŒç­–ç•¥


```java
@Service
public class HybridTokenValidator {
    
    public boolean validate(String token) {
        // â‘  é¦–å…ˆç¦»çº¿éªŒè¯åŸºæœ¬æ ¼å¼å’Œç­¾å
        if (!offlineValidate(token)) {
            return false;
        }
        
        // â‘¡ å¯¹äºæ•æ„Ÿæ“ä½œï¼Œé¢å¤–åœ¨çº¿éªŒè¯
        if (isSensitiveRequest() && !onlineValidate(token)) {
            return false;
        }
        
        return true;
    }
}
```

---

## 6. ğŸ›£ï¸ æƒé™æ§åˆ¶ä¸è·¯ç”±


### 6.1 åŸºäºè§’è‰²çš„è·¯ç”±æ§åˆ¶


```java
@Component
public class RoleBasedRouteFilter implements GlobalFilter {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String path = exchange.getRequest().getPath().toString();
        String userRole = extractUserRole(exchange);
        
        // æ£€æŸ¥è·¯å¾„æƒé™
        if (!hasPathPermission(path, userRole)) {
            return forbiddenResponse(exchange);
        }
        
        return chain.filter(exchange);
    }
    
    private boolean hasPathPermission(String path, String role) {
        // ç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰è·¯å¾„
        if ("ADMIN".equals(role)) {
            return true;
        }
        
        // VIPç”¨æˆ·å¯è®¿é—®ç‰¹å®šè·¯å¾„
        if ("VIP".equals(role) && path.startsWith("/api/vip/")) {
            return true;
        }
        
        // æ™®é€šç”¨æˆ·åªèƒ½è®¿é—®å…¬å¼€æ¥å£
        return path.startsWith("/api/public/");
    }
}
```

### 6.2 åŠ¨æ€è·¯ç”±é…ç½®


```yaml
# è·¯ç”±é…ç½®æ”¯æŒåŠ¨æ€æƒé™
spring:
  cloud:
    gateway:
      routes:
        - id: admin-route
          uri: lb://admin-service
          predicates:
            - Path=/api/admin/**
          filters:
            - name: RoleCheck
              args:
                required-role: ADMIN
                
        - id: user-route
          uri: lb://user-service  
          predicates:
            - Path=/api/users/**
          filters:
            - name: RoleCheck
              args:
                required-role: USER,VIP,ADMIN
```

---

## 7. âŒ è®¤è¯å¤±è´¥å¤„ç†


### 7.1 å¤±è´¥å¤„ç†ç­–ç•¥


**ğŸ”¸ è®¤è¯å¤±è´¥ç±»å‹**ï¼š
```
â‘  ä»¤ç‰Œç¼ºå¤±ï¼šè¿”å›401 Unauthorized
â‘¡ ä»¤ç‰Œæ ¼å¼é”™è¯¯ï¼šè¿”å›400 Bad Request
â‘¢ ä»¤ç‰Œå·²è¿‡æœŸï¼šè¿”å›401 Unauthorizedï¼Œæç¤ºåˆ·æ–°ä»¤ç‰Œ
â‘£ æƒé™ä¸è¶³ï¼šè¿”å›403 Forbidden
â‘¤ æœåŠ¡å¼‚å¸¸ï¼šè¿”å›500 Internal Server Error
```

### 7.2 å¤±è´¥å¤„ç†å®ç°


```java
@Component
public class AuthFailureHandler {
    
    public Mono<Void> handleAuthFailure(ServerWebExchange exchange, AuthFailureType type) {
        ServerHttpResponse response = exchange.getResponse();
        response.setStatusCode(getStatusCode(type));
        response.getHeaders().add("Content-Type", "application/json");
        
        String responseBody = buildErrorResponse(type);
        DataBuffer buffer = response.bufferFactory().wrap(responseBody.getBytes());
        
        return response.writeWith(Mono.just(buffer));
    }
    
    private String buildErrorResponse(AuthFailureType type) {
        return switch (type) {
            case TOKEN_MISSING -> """
                {
                    "code": 401,
                    "message": "è®¿é—®ä»¤ç‰Œç¼ºå¤±",
                    "suggestion": "è¯·åœ¨è¯·æ±‚å¤´ä¸­æä¾›Authorizationä»¤ç‰Œ"
                }
                """;
            case TOKEN_EXPIRED -> """
                {
                    "code": 401,
                    "message": "è®¿é—®ä»¤ç‰Œå·²è¿‡æœŸ",
                    "suggestion": "è¯·ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œé‡æ–°è·å–è®¿é—®ä»¤ç‰Œ"
                }
                """;
            case PERMISSION_DENIED -> """
                {
                    "code": 403,
                    "message": "æƒé™ä¸è¶³",
                    "suggestion": "æ‚¨æ²¡æœ‰è®¿é—®æ­¤èµ„æºçš„æƒé™"
                }
                """;
        };
    }
}
```

### 7.3 é‡è¯•ç­–ç•¥


```java
@Configuration
public class RetryConfiguration {
    
    @Bean
    public RetryGatewayFilterFactory.Config retryConfig() {
        return new RetryGatewayFilterFactory.Config()
            .setRetries(3)  // æœ€å¤šé‡è¯•3æ¬¡
            .setMethods(HttpMethod.GET)  // åªå¯¹GETè¯·æ±‚é‡è¯•
            .setSeries(HttpStatus.Series.SERVER_ERROR)  // åªå¯¹5xxé”™è¯¯é‡è¯•
            .setExceptions(ConnectException.class);  // è¿æ¥å¼‚å¸¸æ—¶é‡è¯•
    }
}
```

---

## 8. ğŸŒ è·¨åŸŸè®¤è¯ç­–ç•¥


### 8.1 Cookieç­–ç•¥è¯¦è§£


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šCookieå°±åƒèº«ä»½è¯ï¼Œæµè§ˆå™¨æ¯æ¬¡è®¿é—®éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Šã€‚ä½†ä¸ºäº†å®‰å…¨ï¼Œéœ€è¦è®¾ç½®ä¸€äº›"ä½¿ç”¨è§„åˆ™"ã€‚

**ğŸ”¸ HttpOnly**ï¼š
```java
// é˜²æ­¢XSSæ”»å‡»ï¼ŒJavaScriptæ— æ³•è®¿é—®Cookie
Cookie cookie = new Cookie("jwt-token", token);
cookie.setHttpOnly(true);  // åªèƒ½é€šè¿‡HTTPè®¿é—®ï¼Œä¸èƒ½ç”¨JSè¯»å–
```

**ğŸ”¸ SameSite**ï¼š
```java
// é˜²æ­¢CSRFæ”»å‡»ï¼Œé™åˆ¶è·¨ç«™è¯·æ±‚æºå¸¦Cookie
Cookie cookie = new Cookie("jwt-token", token);
cookie.setSameSite("Strict");  // ä¸¥æ ¼æ¨¡å¼ï¼šåªæœ‰åŒç«™è¯·æ±‚æ‰æºå¸¦Cookie
// cookie.setSameSite("Lax");     // å®½æ¾æ¨¡å¼ï¼šåŒç«™+å®‰å…¨è·¨ç«™è¯·æ±‚æºå¸¦
// cookie.setSameSite("None");    // æ— é™åˆ¶ï¼šæ‰€æœ‰è¯·æ±‚éƒ½æºå¸¦ï¼ˆéœ€HTTPSï¼‰
```

**ğŸ”¸ Secure**ï¼š
```java
// åªåœ¨HTTPSè¿æ¥ä¸­ä¼ è¾“Cookie
Cookie cookie = new Cookie("jwt-token", token);
cookie.setSecure(true);  // åªåœ¨HTTPSä¸‹ä¼ è¾“
```

### 8.2 è·¨åŸŸé…ç½®ç¤ºä¾‹


```java
@Configuration
public class CorsConfiguration {
    
    @Bean
    public CorsWebFilter corsWebFilter() {
        CorsConfiguration config = new CorsConfiguration();
        
        // å…è®¸çš„æ¥æºåŸŸå
        config.addAllowedOrigin("https://app.example.com");
        config.addAllowedOrigin("https://admin.example.com");
        
        // å…è®¸çš„HTTPæ–¹æ³•
        config.addAllowedMethod("GET");
        config.addAllowedMethod("POST");
        config.addAllowedMethod("PUT");
        config.addAllowedMethod("DELETE");
        
        // å…è®¸çš„è¯·æ±‚å¤´
        config.addAllowedHeader("Authorization");
        config.addAllowedHeader("Content-Type");
        
        // å…è®¸æºå¸¦Cookie
        config.setAllowCredentials(true);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);
        
        return new CorsWebFilter(source);
    }
}
```

---

## 9. ğŸ‘¤ ç”¨æˆ·ä¸Šä¸‹æ–‡ä¼ é€’


### 9.1 ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶


> ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**ï¼šç½‘å…³éªŒè¯ç”¨æˆ·èº«ä»½åï¼Œå°†ç”¨æˆ·ä¿¡æ¯"è´´ä¸ªæ ‡ç­¾"ä¼ é€’ç»™åç»­æœåŠ¡ï¼Œé¿å…é‡å¤éªŒè¯ã€‚

```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¯·æ±‚   â”‚ â†’  â”‚     ç½‘å…³éªŒè¯        â”‚ â†’  â”‚  å¾®æœåŠ¡å¤„ç†  â”‚
â”‚ JWT: xxx   â”‚    â”‚ è§£æ: userId=123   â”‚    â”‚ ç›´æ¥ä½¿ç”¨123  â”‚
â”‚            â”‚    â”‚ æ·»åŠ : X-User-Id    â”‚    â”‚ æ— éœ€å†éªŒè¯   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 å®ç°æ–¹æ¡ˆ


```java
@Component
public class UserContextTransmitter {
    
    public ServerHttpRequest addUserContext(ServerHttpRequest request, String jwt) {
        Claims claims = parseJWT(jwt);
        
        return request.mutate()
            // åŸºæœ¬ç”¨æˆ·ä¿¡æ¯
            .header("X-User-Id", claims.get("userId").toString())
            .header("X-User-Name", claims.get("username").toString())
            .header("X-User-Email", claims.get("email").toString())
            
            // æƒé™ä¿¡æ¯
            .header("X-User-Roles", String.join(",", getUserRoles(claims)))
            .header("X-User-Permissions", String.join(",", getUserPermissions(claims)))
            
            // ç§Ÿæˆ·ä¿¡æ¯ï¼ˆå¤šç§Ÿæˆ·åœºæ™¯ï¼‰
            .header("X-Tenant-Id", claims.get("tenantId").toString())
            
            // è¯·æ±‚è¿½è¸ª
            .header("X-Request-Id", generateRequestId())
            .build();
    }
}
```

### 9.3 å¾®æœåŠ¡æ¥æ”¶ç”¨æˆ·ä¿¡æ¯


```java
@RestController
public class OrderController {
    
    @GetMapping("/orders")
    public List<Order> getUserOrders(HttpServletRequest request) {
        // ä»è¯·æ±‚å¤´è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€éªŒè¯JWT
        String userId = request.getHeader("X-User-Id");
        String userRole = request.getHeader("X-User-Roles");
        
        // ç›´æ¥ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯å¤„ç†ä¸šåŠ¡é€»è¾‘
        return orderService.getOrdersByUserId(userId);
    }
}
```

---

## 10. ğŸš¦ é™æµä¸ç†”æ–­


### 10.1 é™æµç­–ç•¥


**ğŸ”¸ åŸºäºç”¨æˆ·é™æµ**ï¼š
```java
@Component
public class UserRateLimitFilter implements GlobalFilter {
    
    private final RedisTemplate<String, String> redis;
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String userId = getUserId(exchange);
        String key = "rate_limit:user:" + userId;
        
        // ä½¿ç”¨Redisè®¡æ•°å™¨å®ç°é™æµ
        String count = redis.opsForValue().get(key);
        if (count == null) {
            redis.opsForValue().set(key, "1", Duration.ofMinutes(1));
        } else if (Integer.parseInt(count) >= 100) {  // æ¯åˆ†é’Ÿ100æ¬¡
            return rateLimitExceeded(exchange);
        } else {
            redis.opsForValue().increment(key);
        }
        
        return chain.filter(exchange);
    }
}
```

**ğŸ”¸ åŸºäºIPé™æµ**ï¼š
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: api-route
          uri: lb://api-service
          predicates:
            - Path=/api/**
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10  # æ¯ç§’è¡¥å……10ä¸ªä»¤ç‰Œ
                redis-rate-limiter.burstCapacity: 20  # ä»¤ç‰Œæ¡¶å®¹é‡20
                key-resolver: "#{@ipKeyResolver}"     # åŸºäºIPé™æµ
```

### 10.2 ç†”æ–­æœºåˆ¶


```java
@Component
public class CircuitBreakerFilter implements GlobalFilter {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String serviceName = getTargetService(exchange);
        
        return chain.filter(exchange)
            .doOnError(throwable -> {
                // è®°å½•é”™è¯¯ï¼Œç”¨äºç†”æ–­åˆ¤æ–­
                circuitBreakerRegistry.recordError(serviceName, throwable);
            })
            .onErrorResume(throwable -> {
                // ç†”æ–­æ—¶è¿”å›é™çº§å“åº”
                if (circuitBreakerRegistry.isOpen(serviceName)) {
                    return fallbackResponse(exchange);
                }
                return Mono.error(throwable);
            });
    }
    
    private Mono<Void> fallbackResponse(ServerWebExchange exchange) {
        ServerHttpResponse response = exchange.getResponse();
        response.setStatusCode(HttpStatus.SERVICE_UNAVAILABLE);
        
        String body = """
            {
                "code": 503,
                "message": "æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•",
                "timestamp": "%s"
            }
            """.formatted(Instant.now());
            
        DataBuffer buffer = response.bufferFactory().wrap(body.getBytes());
        return response.writeWith(Mono.just(buffer));
    }
}
```

---

## 11. ğŸ¢ å¤šç§Ÿæˆ·å…¥å£éš”ç¦»


### 11.1 éš”ç¦»æ–¹å¼å¯¹æ¯”


| éš”ç¦»æ–¹å¼ | **å®ç°æ–¹æ³•** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|---------|---------|-------------|
| ğŸŒ **åŸŸåéš”ç¦»** | `tenant1.app.com` | `å¤©ç„¶éš”ç¦»ï¼Œç”¨æˆ·ä½“éªŒå¥½` | `åŸŸåæˆæœ¬é«˜ï¼ŒSSLè¯ä¹¦å¤š` | `å¤§å®¢æˆ·ï¼Œç‹¬ç«‹å“ç‰Œ` |
| ğŸ“ **è·¯å¾„éš”ç¦»** | `/tenant1/api/users` | `å®ç°ç®€å•ï¼Œæˆæœ¬ä½` | `URLä¸å¤Ÿç¾è§‚` | `ä¸­å°å®¢æˆ·ï¼Œæˆæœ¬æ•æ„Ÿ` |
| ğŸ“‹ **å¤´éƒ¨éš”ç¦»** | `X-Tenant-ID: tenant1` | `URLç®€æ´ï¼Œçµæ´»` | `éœ€è¦å®¢æˆ·ç«¯æ”¯æŒ` | `APIè°ƒç”¨ï¼ŒæŠ€æœ¯é›†æˆ` |

### 11.2 åŸŸåè·¯ç”±å®ç°


```java
@Component
public class TenantDomainResolver implements GlobalFilter {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String host = exchange.getRequest().getHeaders().getHost().getHostString();
        String tenantId = extractTenantFromDomain(host);
        
        if (tenantId == null) {
            return invalidTenantResponse(exchange);
        }
        
        // æ·»åŠ ç§Ÿæˆ·ä¿¡æ¯åˆ°è¯·æ±‚å¤´
        ServerHttpRequest newRequest = exchange.getRequest().mutate()
            .header("X-Tenant-Id", tenantId)
            .header("X-Tenant-Type", getTenantType(tenantId))
            .build();
            
        return chain.filter(exchange.mutate().request(newRequest).build());
    }
    
    private String extractTenantFromDomain(String host) {
        // tenant1.api.example.com â†’ tenant1
        if (host.matches("^[a-z0-9]+\\.api\\.example\\.com$")) {
            return host.split("\\.")[0];
        }
        return null;
    }
}
```

### 11.3 è·¯å¾„éš”ç¦»é…ç½®


```yaml
spring:
  cloud:
    gateway:
      routes:
        # ç§Ÿæˆ·1è·¯ç”±
        - id: tenant1-route
          uri: lb://tenant1-service
          predicates:
            - Path=/tenant1/**
          filters:
            - StripPrefix=1  # å»æ‰/tenant1å‰ç¼€
            - AddRequestHeader=X-Tenant-Id,tenant1
            
        # ç§Ÿæˆ·2è·¯ç”±  
        - id: tenant2-route
          uri: lb://tenant2-service
          predicates:
            - Path=/tenant2/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Tenant-Id,tenant2
```

---

## 12. ğŸ”§ ä¸»æµç½‘å…³å¯¹æ¯”


### 12.1 æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”


| ç‰¹æ€§ | **Spring Cloud Gateway** | **Kong** | **APISIX** |
|------|------------------------|----------|-------------|
| ğŸ—ï¸ **æ¶æ„** | `åŸºäºWebFluxï¼Œå“åº”å¼` | `åŸºäºOpenResty/Nginx` | `åŸºäºOpenResty/Nginx` |
| ğŸ“ **é…ç½®æ–¹å¼** | `YAMLé…ç½®+Javaä»£ç ` | `RESTful API` | `RESTful API + Dashboard` |
| âš¡ **æ€§èƒ½** | `ä¸­ç­‰ï¼ŒJVMå¼€é”€` | `é«˜ï¼ŒCè¯­è¨€å†…æ ¸` | `é«˜ï¼ŒCè¯­è¨€å†…æ ¸` |
| ğŸ”Œ **æ’ä»¶ç”Ÿæ€** | `Springç”Ÿæ€ï¼ŒJavaæ’ä»¶` | `ä¸°å¯Œæ’ä»¶ï¼ŒLuaå¼€å‘` | `ä¸°å¯Œæ’ä»¶ï¼Œå¤šè¯­è¨€æ”¯æŒ` |
| ğŸ“Š **ç®¡ç†ç•Œé¢** | `éœ€è¦è‡ªå·±å¼€å‘` | `ä»˜è´¹ç‰ˆæä¾›` | `å¼€æºDashboard` |
| ğŸ’° **æˆæœ¬** | `å¼€æºå…è´¹` | `å¼€æº+ä»˜è´¹ç‰ˆæœ¬` | `å®Œå…¨å¼€æº` |

### 12.2 é€‰æ‹©å»ºè®®


**ğŸ”¸ Spring Cloud Gatewayé€‚ç”¨äº**ï¼š
```
âœ… JavaæŠ€æœ¯æ ˆé¡¹ç›®
âœ… Spring Boot/Cloudç”Ÿæ€
âœ… å¼€å‘å›¢é˜Ÿç†Ÿæ‚‰Java
âœ… éœ€è¦æ·±åº¦å®šåˆ¶åŒ–
âœ… ä¸­å°è§„æ¨¡åº”ç”¨
```

**ğŸ”¸ Kongé€‚ç”¨äº**ï¼š
```
âœ… é«˜æ€§èƒ½è¦æ±‚
âœ… å¤šè¯­è¨€æœåŠ¡
âœ… ä¼ä¸šçº§ç‰¹æ€§éœ€æ±‚
âœ… é¢„ç®—å……è¶³ï¼ˆä»˜è´¹ç‰ˆï¼‰
âœ… è¿ç»´å›¢é˜Ÿç»éªŒä¸°å¯Œ
```

**ğŸ”¸ APISIXé€‚ç”¨äº**ï¼š
```
âœ… é«˜æ€§èƒ½+å¼€æº
âœ… äº‘åŸç”Ÿç¯å¢ƒ
âœ… å¤šè¯­è¨€æ’ä»¶æ”¯æŒ
âœ… ç°ä»£åŒ–ç®¡ç†ç•Œé¢
âœ… å¿«é€Ÿä¸Šæ‰‹éœ€æ±‚
```

### 12.3 æ€§èƒ½å¯¹æ¯”


```
å‹æµ‹åœºæ™¯ï¼š1000å¹¶å‘ï¼ŒæŒç»­10åˆ†é’Ÿ
ç¡¬ä»¶é…ç½®ï¼š4C8Gï¼ŒSSDå­˜å‚¨

æ€§èƒ½ç»“æœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç½‘å…³        â”‚   QPS    â”‚  å»¶è¿Ÿ    â”‚ CPUä½¿ç”¨ç‡ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Spring Gateway  â”‚  15,000  â”‚   20ms   â”‚   60%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Kong            â”‚  25,000  â”‚   12ms   â”‚   40%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ APISIX          â”‚  28,000  â”‚   10ms   â”‚   35%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 13. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 13.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç»Ÿä¸€è®¤è¯ç½‘å…³ï¼šé›†ä¸­å¤„ç†æ‰€æœ‰è¯·æ±‚çš„èº«ä»½éªŒè¯å’Œæƒé™æ£€æŸ¥
ğŸ”¸ JWTä¼ æ’­æœºåˆ¶ï¼šä»¤ç‰Œåœ¨å¾®æœåŠ¡é—´ä¼ é€’ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯
ğŸ”¸ èŒè´£è¾¹ç•Œï¼šç½‘å…³è´Ÿè´£é€šç”¨è®¤è¯ï¼Œå¾®æœåŠ¡è´Ÿè´£ä¸šåŠ¡æƒé™
ğŸ”¸ æ ¡éªŒç­–ç•¥ï¼šç¦»çº¿æ ¡éªŒæ€§èƒ½å¥½ï¼Œåœ¨çº¿æ ¡éªŒå®æ—¶æ€§å¼º
ğŸ”¸ å¤±è´¥å¤„ç†ï¼šå‹å¥½çš„é”™è¯¯æç¤ºå’Œé€‚å½“çš„é‡è¯•æœºåˆ¶
ğŸ”¸ è·¨åŸŸå®‰å…¨ï¼šåˆç†çš„Cookieç­–ç•¥å’ŒCORSé…ç½®
ğŸ”¸ å¤šç§Ÿæˆ·éš”ç¦»ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åŸŸåã€è·¯å¾„æˆ–å¤´éƒ¨éš”ç¦»
```

### 13.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€è®¤è¯**ï¼š
```
é—®é¢˜è§£å†³ï¼š
- é¿å…é‡å¤å¼€å‘è®¤è¯é€»è¾‘
- é›†ä¸­ç®¡ç†å®‰å…¨ç­–ç•¥
- ç®€åŒ–å†…éƒ¨æœåŠ¡è°ƒç”¨
- æé«˜ç³»ç»Ÿå®‰å…¨æ€§

å®é™…ä»·å€¼ï¼š
- å¼€å‘æ•ˆç‡æå‡50%ä»¥ä¸Š
- å®‰å…¨æ¼æ´å‡å°‘80%
- è¿ç»´ç®¡ç†ç®€åŒ–
- æ€§èƒ½ä¼˜åŒ–ç©ºé—´æ›´å¤§
```

**ğŸ”¹ JWTä¼ æ’­çš„æœ¬è´¨**ï¼š
```
è®¾è®¡æ€æƒ³ï¼š
- ç½‘å…³éªŒè¯ä¸€æ¬¡ï¼Œå…¨é“¾è·¯ä¿¡ä»»
- ç”¨æˆ·ä¿¡æ¯é€šè¿‡HTTPå¤´ä¼ é€’
- é¿å…é‡å¤çš„ä»¤ç‰ŒéªŒè¯å¼€é”€
- ä¿æŒæœåŠ¡é—´çš„æ¾è€¦åˆ

æ³¨æ„äº‹é¡¹ï¼š
- å†…ç½‘ä¼ è¾“ç›¸å¯¹å®‰å…¨
- æ•æ„Ÿä¿¡æ¯éœ€è¦åŠ å¯†
- æœåŠ¡é—´è¦éªŒè¯æ¥æº
- å»ºç«‹ä¿¡ä»»è¾¹ç•Œ
```

**ğŸ”¹ æ€§èƒ½ä¸å®‰å…¨çš„å¹³è¡¡**ï¼š
```
æ€§èƒ½ä¼˜åŒ–ï¼š
- ç¦»çº¿éªŒè¯å‡å°‘ç½‘ç»œå¼€é”€
- ç¼“å­˜ç”¨æˆ·ä¿¡æ¯
- è¿æ¥æ± å¤ç”¨
- å¼‚æ­¥å¤„ç†

å®‰å…¨åŠ å¼ºï¼š
- HTTPSå¼ºåˆ¶åŠ å¯†
- ä»¤ç‰Œå®šæœŸè½®æ¢
- å¼‚å¸¸è¡Œä¸ºç›‘æ§
- è®¿é—®æ—¥å¿—å®¡è®¡
```

### 13.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ¶æ„è®¾è®¡åŸåˆ™**ï¼š
```
â‘  å•ä¸€å…¥å£ï¼šæ‰€æœ‰å¤–éƒ¨è¯·æ±‚å¿…é¡»ç»è¿‡ç½‘å…³
â‘¡ èŒè´£åˆ†ç¦»ï¼šç½‘å…³å¤„ç†è®¤è¯ï¼ŒæœåŠ¡å¤„ç†æˆæƒ
â‘¢ fail-fastï¼šè®¤è¯å¤±è´¥ç«‹å³è¿”å›ï¼Œé¿å…èµ„æºæµªè´¹
â‘£ å¯è§‚æµ‹æ€§ï¼šå®Œæ•´çš„æ—¥å¿—å’Œç›‘æ§ä½“ç³»
â‘¤ é«˜å¯ç”¨ï¼šç½‘å…³é›†ç¾¤éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœ
```

**ğŸ› ï¸ å®æ–½å»ºè®®**ï¼š
```
å¼€å‘é˜¶æ®µï¼š
- å…ˆå®ç°åŸºæœ¬è®¤è¯åŠŸèƒ½
- é€æ­¥æ·»åŠ é™æµç†”æ–­
- å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶
- æ·»åŠ ç›‘æ§å’Œæ—¥å¿—

ç”Ÿäº§éƒ¨ç½²ï¼š
- ç½‘å…³é›†ç¾¤éƒ¨ç½²
- é…ç½®å¥åº·æ£€æŸ¥
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- å‡†å¤‡åº”æ€¥é¢„æ¡ˆ

è¿ç»´ç›‘æ§ï¼š
- å…³é”®æŒ‡æ ‡ï¼šQPSã€å»¶è¿Ÿã€é”™è¯¯ç‡
- å‘Šè­¦è§„åˆ™ï¼šè®¤è¯å¤±è´¥ç‡è¿‡é«˜
- å®¹é‡è§„åˆ’ï¼šæ ¹æ®ä¸šåŠ¡å¢é•¿é¢„æµ‹
- å®‰å…¨å®¡è®¡ï¼šå®šæœŸæ£€æŸ¥è®¿é—®æ—¥å¿—
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç»Ÿä¸€è®¤è¯ç½‘å…³æ˜¯å¾®æœåŠ¡å®‰å…¨çš„ç¬¬ä¸€é“é˜²çº¿
- JWTä¼ æ’­è®©æœåŠ¡é—´è°ƒç”¨æ›´é«˜æ•ˆæ›´å®‰å…¨
- åˆç†çš„èŒè´£åˆ’åˆ†æ˜¯æ¶æ„æˆåŠŸçš„å…³é”®
- æ€§èƒ½å’Œå®‰å…¨éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯å¹³è¡¡
- é€‰æ‹©åˆé€‚çš„ç½‘å…³æŠ€æœ¯æ ˆå¾ˆé‡è¦