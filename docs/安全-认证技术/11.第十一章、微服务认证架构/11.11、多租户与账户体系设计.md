---
title: 11ã€å¤šç§Ÿæˆ·ä¸è´¦æˆ·ä½“ç³»è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [å¤šç§Ÿæˆ·ç³»ç»Ÿæ¦‚å¿µä¸è®¾è®¡](#1-å¤šç§Ÿæˆ·ç³»ç»Ÿæ¦‚å¿µä¸è®¾è®¡)
2. [ç§Ÿæˆ·æ¨¡å‹ä¸éš”ç¦»ç­–ç•¥](#2-ç§Ÿæˆ·æ¨¡å‹ä¸éš”ç¦»ç­–ç•¥)
3. [ç§Ÿæˆ·ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶](#3-ç§Ÿæˆ·ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶)
4. [ç§Ÿæˆ·çº§ç­–ç•¥ä¸èµ„æºç®¡æ§](#4-ç§Ÿæˆ·çº§ç­–ç•¥ä¸èµ„æºç®¡æ§)
5. [è‡ªåŠ©æ³¨å†Œä¸è´¦æˆ·ç»‘å®š](#5-è‡ªåŠ©æ³¨å†Œä¸è´¦æˆ·ç»‘å®š)
6. [è´¦æˆ·åˆå¹¶ä¸ç¬¬ä¸‰æ–¹é›†æˆ](#6-è´¦æˆ·åˆå¹¶ä¸ç¬¬ä¸‰æ–¹é›†æˆ)
7. [è®¡é‡å®¡è®¡ä¸è®¡è´¹è®¾è®¡](#7-è®¡é‡å®¡è®¡ä¸è®¡è´¹è®¾è®¡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¢ å¤šç§Ÿæˆ·ç³»ç»Ÿæ¦‚å¿µä¸è®¾è®¡


### 1.1 ä»€ä¹ˆæ˜¯å¤šç§Ÿæˆ·ç³»ç»Ÿ


**ğŸ”¸ é€šä¿—ç†è§£**
å¤šç§Ÿæˆ·ç³»ç»Ÿå°±åƒä¸€æ ‹**å…¬å¯“æ¥¼**ï¼Œæ¯ä¸ªç§Ÿæˆ·ï¼ˆå…¬å¸ã€å›¢é˜Ÿï¼‰éƒ½æœ‰è‡ªå·±çš„**ç‹¬ç«‹æˆ¿é—´**ï¼Œä½†**å…±äº«**æ¥¼é‡Œçš„åŸºç¡€è®¾æ–½ï¼ˆç”µæ¢¯ã€æ°´ç”µã€å®‰ä¿ï¼‰ã€‚

```
ä¼ ç»Ÿå•ç§Ÿæˆ·ç³»ç»Ÿï¼š           å¤šç§Ÿæˆ·ç³»ç»Ÿï¼š
æ¯ä¸ªå®¢æˆ·ä¸€å¥—ç‹¬ç«‹ç³»ç»Ÿ        ä¸€å¥—ç³»ç»ŸæœåŠ¡å¤šä¸ªå®¢æˆ·

å®¢æˆ·A â†’ ç³»ç»ŸA              å®¢æˆ·A â†˜
å®¢æˆ·B â†’ ç³»ç»ŸB                      â†“ å…±äº«ç³»ç»Ÿ â† æ•°æ®éš”ç¦»
å®¢æˆ·C â†’ ç³»ç»ŸC              å®¢æˆ·B â†—     â†‘
                          å®¢æˆ·C â†—     â†“
                                    å®¢æˆ·D
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**
- **ç§Ÿæˆ·ï¼ˆTenantï¼‰**ï¼šç³»ç»Ÿçš„ä½¿ç”¨æ–¹ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª**å…¬å¸ã€ç»„ç»‡æˆ–å›¢é˜Ÿ**
- **å¤šç§Ÿæˆ·ï¼ˆMulti-Tenancyï¼‰**ï¼š**ä¸€å¥—ç³»ç»ŸåŒæ—¶ä¸ºå¤šä¸ªç§Ÿæˆ·æä¾›æœåŠ¡**
- **ç§Ÿæˆ·éš”ç¦»**ï¼šç¡®ä¿ç§Ÿæˆ·é—´çš„**æ•°æ®å’Œæ“ä½œäº’ä¸å¹²æ‰°**

### 1.2 å¤šç§Ÿæˆ·çš„æ ¸å¿ƒä»·å€¼


**ğŸ’° æˆæœ¬æ•ˆç›Š**
```
å•ç§Ÿæˆ·æˆæœ¬ï¼šNä¸ªå®¢æˆ· Ã— å®Œæ•´ç³»ç»Ÿæˆæœ¬
å¤šç§Ÿæˆ·æˆæœ¬ï¼š1å¥—ç³»ç»Ÿæˆæœ¬ Ã· Nä¸ªå®¢æˆ·

å®é™…æ¡ˆä¾‹ï¼š
- SaaSè½¯ä»¶å‚å•†ï¼šåŒä¸€å¥—CRMç³»ç»ŸæœåŠ¡1000å®¶ä¼ä¸š
- äº‘æœåŠ¡å•†ï¼šåŒä¸€å¥—åŸºç¡€è®¾æ–½æœåŠ¡æ•°ä¸‡ç”¨æˆ·
```

**ğŸ”¸ ä¸šåŠ¡åœºæ™¯**
- **B2B SaaSå¹³å°**ï¼šæ¯ä¸ªä¼ä¸šå®¢æˆ·æ˜¯ä¸€ä¸ªç§Ÿæˆ·
- **ç”µå•†å¹³å°**ï¼šæ¯ä¸ªå•†å®¶æ˜¯ä¸€ä¸ªç§Ÿæˆ·
- **åä½œå·¥å…·**ï¼šæ¯ä¸ªå›¢é˜Ÿ/ç»„ç»‡æ˜¯ä¸€ä¸ªç§Ÿæˆ·

---

## 2. ğŸ—ï¸ ç§Ÿæˆ·æ¨¡å‹ä¸éš”ç¦»ç­–ç•¥


### 2.1 éš”ç¦»çº§åˆ«è®¾è®¡


**ğŸ”¸ é€»è¾‘éš”ç¦» vs ç‰©ç†éš”ç¦»**

```
é€»è¾‘éš”ç¦»ï¼šå…±äº«åŸºç¡€è®¾æ–½ï¼Œé€šè¿‡è½¯ä»¶å±‚é¢åŒºåˆ†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åº”ç”¨å±‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç§Ÿæˆ·Aæ•°æ®  â”‚  ç§Ÿæˆ·Bæ•°æ®  â”‚  ç§Ÿæˆ·Cæ•°æ® â”‚  â† é€šè¿‡tenant_idåŒºåˆ†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        å…±äº«æ•°æ®åº“               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰©ç†éš”ç¦»ï¼šæ¯ä¸ªç§Ÿæˆ·ç‹¬ç«‹çš„åŸºç¡€è®¾æ–½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç§Ÿæˆ·A    â”‚  â”‚ ç§Ÿæˆ·B    â”‚  â”‚ ç§Ÿæˆ·C    â”‚
â”‚ ç‹¬ç«‹DB   â”‚  â”‚ ç‹¬ç«‹DB   â”‚  â”‚ ç‹¬ç«‹DB   â”‚
â”‚ ç‹¬ç«‹åº”ç”¨  â”‚  â”‚ ç‹¬ç«‹åº”ç”¨  â”‚  â”‚ ç‹¬ç«‹åº”ç”¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š éš”ç¦»çº§åˆ«å¯¹æ¯”**

| éš”ç¦»ç±»å‹ | **æˆæœ¬** | **å®‰å…¨æ€§** | **æ€§èƒ½** | **ç»´æŠ¤å¤æ‚åº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|-----------|---------|---------------|-------------|
| **é€»è¾‘éš”ç¦»** | `ä½` | `ä¸­` | `é«˜ï¼ˆå…±äº«èµ„æºï¼‰` | `ä½` | `å¤§å¤šæ•°SaaSåº”ç”¨` |
| **æ··åˆéš”ç¦»** | `ä¸­` | `é«˜` | `ä¸­` | `ä¸­` | `æ•æ„Ÿæ•°æ®+æˆæœ¬æ§åˆ¶` |
| **ç‰©ç†éš”ç¦»** | `é«˜` | `æé«˜` | `ä¸­ï¼ˆèµ„æºç‹¬äº«ï¼‰` | `é«˜` | `é‡‘èã€åŒ»ç–—ç­‰é«˜å®‰å…¨è¦æ±‚` |

### 2.2 ç§Ÿæˆ·ç»„ç»‡ç»“æ„æ¨¡å‹


**ğŸ”¸ è®¿å®¢æ¨¡å¼**
```java
// æœ€ç®€å•çš„ç§Ÿæˆ·æ¨¡å‹ï¼šæ³¨å†Œå³æˆä¸ºç‹¬ç«‹ç§Ÿæˆ·
public class GuestTenantModel {
    private String tenantId;      // è‡ªåŠ¨ç”Ÿæˆçš„ç§Ÿæˆ·ID
    private String userEmail;     // ç”¨æˆ·é‚®ç®±ä½œä¸ºè´¦æˆ·æ ‡è¯†
    private TenantType type = TenantType.INDIVIDUAL;  // ä¸ªäººç§Ÿæˆ·
    
    // ç‰¹ç‚¹ï¼šä¸€ä¸ªç”¨æˆ·å°±æ˜¯ä¸€ä¸ªç§Ÿæˆ·
    // é€‚ç”¨ï¼šä¸ªäººå·¥å…·ã€è½»é‡çº§åº”ç”¨
}
```

**ğŸ”¸ å­è´¦å·æ¨¡å¼**
```java
// æ”¯æŒä¸»è´¦æˆ·ä¸‹åˆ›å»ºå¤šä¸ªå­è´¦æˆ·
public class SubAccountModel {
    private String masterTenantId;     // ä¸»ç§Ÿæˆ·ID
    private String subAccountId;       // å­è´¦æˆ·ID
    private List<String> permissions;  // å­è´¦æˆ·æƒé™åˆ—è¡¨
    private String createdBy;          // åˆ›å»ºè€…ï¼ˆä¸»è´¦æˆ·ï¼‰
    
    // ç‰¹ç‚¹ï¼šä¸»è´¦æˆ·ç®¡ç†ï¼Œå­è´¦æˆ·ä½¿ç”¨
    // é€‚ç”¨ï¼šä¼ä¸šå†…éƒ¨å¤šäººåä½œ
}
```

**ğŸ”¸ ç»„ç»‡ç»“æ„æ¨¡å¼**
```java
// å¤æ‚çš„ç»„ç»‡å±‚çº§ç»“æ„
public class OrganizationModel {
    private String tenantId;
    private String organizationName;
    private List<Department> departments;  // éƒ¨é—¨åˆ—è¡¨
    private Map<String, Role> roleMapping; // ç”¨æˆ·è§’è‰²æ˜ å°„
    
    // æ”¯æŒéƒ¨é—¨ã€è§’è‰²ã€æƒé™çš„å¤æ‚ç»„åˆ
    // é€‚ç”¨ï¼šå¤§å‹ä¼ä¸šã€å¤æ‚ç»„ç»‡æ¶æ„
}
```

---

## 3. ğŸ”„ ç§Ÿæˆ·ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶


### 3.1 HTTP Headerä¼ é€’æ–¹å¼


**ğŸ”¸ X-Tenant-ID Headeræ ‡å‡†**
```http
# å®¢æˆ·ç«¯è¯·æ±‚ç¤ºä¾‹
GET /api/users HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJ0eXAiOiJKV1Q...
X-Tenant-ID: tenant_12345
Content-Type: application/json
```

**ğŸ”¸ åç«¯å¤„ç†å®ç°**
```java
@Component
public class TenantContextInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        // 1. ä»Headerä¸­æå–ç§Ÿæˆ·ID
        String tenantId = request.getHeader("X-Tenant-ID");
        
        // 2. éªŒè¯ç§Ÿæˆ·IDæœ‰æ•ˆæ€§
        if (!isValidTenant(tenantId)) {
            response.setStatus(403);
            return false;
        }
        
        // 3. è®¾ç½®åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡
        TenantContext.setCurrentTenant(tenantId);
        return true;
    }
    
    @Override
    public void afterCompletion(HttpServletRequest request,
                              HttpServletResponse response,
                              Object handler, Exception ex) {
        // æ¸…ç†çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œé¿å…å†…å­˜æ³„æ¼
        TenantContext.clear();
    }
}

// çº¿ç¨‹æœ¬åœ°å­˜å‚¨ç§Ÿæˆ·ä¸Šä¸‹æ–‡
public class TenantContext {
    private static final ThreadLocal<String> CURRENT_TENANT = new ThreadLocal<>();
    
    public static void setCurrentTenant(String tenantId) {
        CURRENT_TENANT.set(tenantId);
    }
    
    public static String getCurrentTenant() {
        return CURRENT_TENANT.get();
    }
    
    public static void clear() {
        CURRENT_TENANT.remove();
    }
}
```

### 3.2 ä»¤ç‰Œå†…Claimsä¼ é€’


**ğŸ”¸ JWTä¸­åµŒå…¥ç§Ÿæˆ·ä¿¡æ¯**
```java
// JWTä»¤ç‰ŒåŒ…å«ç§Ÿæˆ·ä¿¡æ¯
{
  "sub": "user123",                    // ç”¨æˆ·ID
  "tenant_id": "company_abc",          // ç§Ÿæˆ·ID
  "tenant_name": "ABCå…¬å¸",            // ç§Ÿæˆ·åç§°
  "role": "admin",                     // ç”¨æˆ·åœ¨è¯¥ç§Ÿæˆ·ä¸‹çš„è§’è‰²
  "permissions": ["read", "write"],    // æƒé™åˆ—è¡¨
  "exp": 1640995200                    // è¿‡æœŸæ—¶é—´
}
```

**ğŸ”¸ ä»¤ç‰Œè§£æä¸éªŒè¯**
```java
@Service
public class JwtTenantService {
    
    public TenantInfo extractTenantInfo(String token) {
        Claims claims = Jwts.parser()
            .setSigningKey(secretKey)
            .parseClaimsJws(token)
            .getBody();
            
        return TenantInfo.builder()
            .tenantId(claims.get("tenant_id", String.class))
            .tenantName(claims.get("tenant_name", String.class))
            .userRole(claims.get("role", String.class))
            .permissions(claims.get("permissions", List.class))
            .build();
    }
    
    // éªŒè¯ç”¨æˆ·æ˜¯å¦å±äºæŒ‡å®šç§Ÿæˆ·
    public boolean validateTenantAccess(String token, String requestedTenantId) {
        TenantInfo tenantInfo = extractTenantInfo(token);
        return requestedTenantId.equals(tenantInfo.getTenantId());
    }
}
```

---

## 4. âš–ï¸ ç§Ÿæˆ·çº§ç­–ç•¥ä¸èµ„æºç®¡æ§


### 4.1 ç§Ÿæˆ·çº§é™æµç­–ç•¥


**ğŸ”¸ åŸºäºç§Ÿæˆ·çš„é™æµè®¾è®¡**
```java
@Component
public class TenantRateLimiter {
    private final Map<String, RateLimiter> tenantLimiters = new ConcurrentHashMap<>();
    
    // ä¸åŒç§Ÿæˆ·å¥—é¤æœ‰ä¸åŒçš„é™æµé…ç½®
    private final Map<String, RateLimitConfig> tenantConfigs = Map.of(
        "BASIC", new RateLimitConfig(100, TimeUnit.MINUTES),      // åŸºç¡€ç‰ˆï¼š100æ¬¡/åˆ†é’Ÿ
        "PRO", new RateLimitConfig(1000, TimeUnit.MINUTES),       // ä¸“ä¸šç‰ˆï¼š1000æ¬¡/åˆ†é’Ÿ
        "ENTERPRISE", new RateLimitConfig(10000, TimeUnit.MINUTES) // ä¼ä¸šç‰ˆï¼š10000æ¬¡/åˆ†é’Ÿ
    );
    
    public boolean allowRequest(String tenantId) {
        // 1. è·å–ç§Ÿæˆ·çš„å¥—é¤ç±»å‹
        String planType = getTenantPlan(tenantId);
        
        // 2. è·å–å¯¹åº”çš„é™æµå™¨
        RateLimiter limiter = tenantLimiters.computeIfAbsent(tenantId, 
            k -> createRateLimiter(planType));
            
        // 3. æ£€æŸ¥æ˜¯å¦å…è®¸è¯·æ±‚
        return limiter.tryAcquire();
    }
}
```

### 4.2 èµ„æºé…é¢ç®¡ç†


**ğŸ”¸ å­˜å‚¨ä¸è®¡ç®—èµ„æºé…é¢**
```java
// ç§Ÿæˆ·èµ„æºé…é¢é…ç½®
@Entity
public class TenantQuota {
    private String tenantId;
    
    // å­˜å‚¨é…é¢ï¼ˆå•ä½ï¼šGBï¼‰
    private Long storageQuotaGB;
    private Long storageUsedGB;
    
    // APIè°ƒç”¨é…é¢
    private Long apiCallsQuota;
    private Long apiCallsUsed;
    
    // ç”¨æˆ·æ•°é‡é™åˆ¶
    private Integer maxUsers;
    private Integer currentUsers;
    
    // æ£€æŸ¥é…é¢æ˜¯å¦è¶…é™
    public boolean isStorageQuotaExceeded() {
        return storageUsedGB >= storageQuotaGB;
    }
    
    public boolean canAddUser() {
        return currentUsers < maxUsers;
    }
}

@Service
public class QuotaService {
    
    // æ£€æŸ¥æ“ä½œå‰çš„é…é¢éªŒè¯
    public boolean checkQuotaBeforeOperation(String tenantId, OperationType type) {
        TenantQuota quota = getTenantQuota(tenantId);
        
        switch (type) {
            case FILE_UPLOAD:
                return !quota.isStorageQuotaExceeded();
            case ADD_USER:
                return quota.canAddUser();
            case API_CALL:
                return quota.getApiCallsUsed() < quota.getApiCallsQuota();
            default:
                return true;
        }
    }
}
```

### 4.3 æƒé™æ¨¡æ¿ç³»ç»Ÿ


**ğŸ”¸ ç§Ÿæˆ·çº§æƒé™æ¨¡æ¿**
```java
// é¢„å®šä¹‰çš„æƒé™æ¨¡æ¿
public enum PermissionTemplate {
    BASIC_TENANT(Set.of("read:own", "write:own")),
    PRO_TENANT(Set.of("read:own", "write:own", "read:team", "write:team")),
    ENTERPRISE_TENANT(Set.of("read:all", "write:all", "admin:tenant", "admin:users"));
    
    private final Set<String> permissions;
}

@Service
public class TenantPermissionService {
    
    // ä¸ºæ–°ç§Ÿæˆ·åˆ†é…é»˜è®¤æƒé™æ¨¡æ¿
    public void assignDefaultPermissions(String tenantId, TenantPlan plan) {
        PermissionTemplate template = getTemplateByPlan(plan);
        
        TenantPermission tenantPermission = TenantPermission.builder()
            .tenantId(tenantId)
            .permissions(template.getPermissions())
            .createdAt(Instant.now())
            .build();
            
        permissionRepository.save(tenantPermission);
    }
    
    // å‡çº§ç§Ÿæˆ·æ—¶æ›´æ–°æƒé™
    public void upgradeTenantPermissions(String tenantId, TenantPlan newPlan) {
        PermissionTemplate newTemplate = getTemplateByPlan(newPlan);
        updateTenantPermissions(tenantId, newTemplate.getPermissions());
    }
}
```

---

## 5. ğŸ“ è‡ªåŠ©æ³¨å†Œä¸è´¦æˆ·ç»‘å®š


### 5.1 ç§Ÿæˆ·è‡ªåŠ©æ³¨å†Œæµç¨‹


**ğŸ”¸ æ³¨å†Œæµç¨‹è®¾è®¡**
```
ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼š
1. ç”¨æˆ·å¡«å†™æ³¨å†Œä¿¡æ¯ â†’ 2. é‚®ç®±éªŒè¯ â†’ 3. é€‰æ‹©å¥—é¤ â†’ 4. åˆ›å»ºç§Ÿæˆ· â†’ 5. å®Œæˆæ³¨å†Œ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¡«å†™ä¿¡æ¯    â”‚ â†’ â”‚  é‚®ç®±éªŒè¯    â”‚ â†’ â”‚  é€‰æ‹©å¥—é¤    â”‚
â”‚  - é‚®ç®±     â”‚    â”‚  - å‘é€éªŒè¯ç  â”‚    â”‚  - BASIC    â”‚
â”‚  - å¯†ç      â”‚    â”‚  - ç‚¹å‡»ç¡®è®¤  â”‚    â”‚  - PRO      â”‚
â”‚  - å…¬å¸å   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  - ENTERPRISEâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®Œæˆæ³¨å†Œ    â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  åˆ›å»ºç§Ÿæˆ·    â”‚
â”‚  - ç™»å½•ç³»ç»Ÿ  â”‚                      â”‚  - ç”ŸæˆID   â”‚
â”‚  - åˆå§‹åŒ–    â”‚                      â”‚  - è®¾ç½®é…é¢  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ æ³¨å†ŒæœåŠ¡å®ç°**
```java
@Service
public class TenantRegistrationService {
    
    public TenantRegistrationResult registerTenant(TenantRegistrationRequest request) {
        // 1. éªŒè¯æ³¨å†Œä¿¡æ¯
        validateRegistrationRequest(request);
        
        // 2. åˆ›å»ºç§Ÿæˆ·
        String tenantId = generateTenantId();
        Tenant tenant = Tenant.builder()
            .tenantId(tenantId)
            .tenantName(request.getCompanyName())
            .ownerEmail(request.getEmail())
            .plan(request.getSelectedPlan())
            .status(TenantStatus.ACTIVE)
            .createdAt(Instant.now())
            .build();
        
        tenantRepository.save(tenant);
        
        // 3. åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
        User adminUser = createAdminUser(request, tenantId);
        
        // 4. åˆ†é…åˆå§‹æƒé™å’Œé…é¢
        assignDefaultPermissions(tenantId, request.getSelectedPlan());
        initializeQuota(tenantId, request.getSelectedPlan());
        
        // 5. å‘é€æ¬¢è¿é‚®ä»¶
        sendWelcomeEmail(adminUser);
        
        return TenantRegistrationResult.success(tenantId, adminUser.getUserId());
    }
    
    private String generateTenantId() {
        // ç”Ÿæˆå”¯ä¸€çš„ç§Ÿæˆ·IDï¼Œä¾‹å¦‚ï¼štenant_20250114_abc123
        return "tenant_" + 
               LocalDate.now().format(DateTimeFormatter.BASIC_ISO_DATE) + 
               "_" + RandomStringUtils.randomAlphanumeric(6).toLowerCase();
    }
}
```

### 5.2 ç¬¬ä¸‰æ–¹ç™»å½•ç»‘å®šæœºåˆ¶


**ğŸ”¸ ç¬¬ä¸‰æ–¹ç™»å½•ç»‘å®šæµç¨‹**
```java
@Service
public class ThirdPartyBindingService {
    
    // å¤„ç†ç¬¬ä¸‰æ–¹ç™»å½•å›è°ƒ
    public LoginResult handleThirdPartyCallback(ThirdPartyCallbackData callbackData) {
        // 1. éªŒè¯ç¬¬ä¸‰æ–¹ä»¤ç‰Œ
        ThirdPartyUserInfo thirdPartyUser = validateThirdPartyToken(callbackData);
        
        // 2. æ£€æŸ¥æ˜¯å¦å·²æœ‰ç»‘å®šè´¦æˆ·
        Optional<User> existingUser = userRepository
            .findByThirdPartyId(thirdPartyUser.getProvider(), thirdPartyUser.getId());
            
        if (existingUser.isPresent()) {
            // å·²ç»‘å®šï¼Œç›´æ¥ç™»å½•
            return createLoginResult(existingUser.get());
        } else {
            // æœªç»‘å®šï¼Œæä¾›ç»‘å®šé€‰é¡¹
            return LoginResult.requireBinding(thirdPartyUser);
        }
    }
    
    // ç»‘å®šåˆ°ç°æœ‰è´¦æˆ·
    public BindingResult bindToExistingAccount(String email, String password, 
                                             ThirdPartyUserInfo thirdPartyUser) {
        // 1. éªŒè¯ç°æœ‰è´¦æˆ·
        User existingUser = authenticateUser(email, password);
        if (existingUser == null) {
            return BindingResult.failure("è´¦æˆ·éªŒè¯å¤±è´¥");
        }
        
        // 2. åˆ›å»ºç»‘å®šå…³ç³»
        ThirdPartyBinding binding = ThirdPartyBinding.builder()
            .userId(existingUser.getUserId())
            .provider(thirdPartyUser.getProvider())
            .thirdPartyUserId(thirdPartyUser.getId())
            .bindingTime(Instant.now())
            .build();
            
        bindingRepository.save(binding);
        
        return BindingResult.success();
    }
}
```

---

## 6. ğŸ”— è´¦æˆ·åˆå¹¶ä¸ç¬¬ä¸‰æ–¹é›†æˆ


### 6.1 è´¦æˆ·åˆå¹¶ç­–ç•¥


**ğŸ”¸ åˆå¹¶è§¦å‘åœºæ™¯**
```
è´¦æˆ·åˆå¹¶çš„å¸¸è§åœºæ™¯ï¼š

1. é‚®ç®±é‡å¤ï¼š
   ç”¨æˆ·Aï¼šemail@example.com (æœ¬åœ°è´¦æˆ·)
   ç”¨æˆ·Bï¼šemail@example.com (Googleç™»å½•)
   â†’ æ£€æµ‹åˆ°é‚®ç®±ç›¸åŒï¼Œæç¤ºåˆå¹¶

2. æ‰‹æœºå·é‡å¤ï¼š
   ç”¨æˆ·Aï¼š+86-138xxxx1234 (å¾®ä¿¡ç™»å½•)
   ç”¨æˆ·Bï¼š+86-138xxxx1234 (æœ¬åœ°è´¦æˆ·)
   â†’ é€šè¿‡çŸ­ä¿¡éªŒè¯ç¡®è®¤åˆå¹¶

3. ç¬¬ä¸‰æ–¹å¤šå¹³å°ï¼š
   ç”¨æˆ·Aï¼šé€šè¿‡Googleç™»å½•
   ç”¨æˆ·Bï¼šé€šè¿‡GitHubç™»å½•ï¼Œä½†é‚®ç®±ç›¸åŒ
   â†’ åˆå¹¶ä¸ºåŒä¸€è´¦æˆ·ï¼Œæ”¯æŒå¤šç§ç™»å½•æ–¹å¼
```

**ğŸ”¸ è´¦æˆ·åˆå¹¶å®ç°**
```java
@Service
public class AccountMergeService {
    
    public MergeResult mergeAccounts(String primaryUserId, String secondaryUserId) {
        User primaryUser = userRepository.findById(primaryUserId).orElseThrow();
        User secondaryUser = userRepository.findById(secondaryUserId).orElseThrow();
        
        // 1. æ•°æ®åˆå¹¶å‰çš„å†²çªæ£€æŸ¥
        MergeConflictCheck conflictCheck = checkMergeConflicts(primaryUser, secondaryUser);
        if (conflictCheck.hasConflicts()) {
            return MergeResult.conflict(conflictCheck.getConflicts());
        }
        
        // 2. åˆå¹¶ç”¨æˆ·æ•°æ®
        mergeUserData(primaryUser, secondaryUser);
        
        // 3. è½¬ç§»ç¬¬ä¸‰æ–¹ç»‘å®šå…³ç³»
        transferThirdPartyBindings(secondaryUserId, primaryUserId);
        
        // 4. æ›´æ–°å…³è”æ•°æ®çš„ç”¨æˆ·IDå¼•ç”¨
        updateUserReferences(secondaryUserId, primaryUserId);
        
        // 5. åˆ é™¤æ¬¡è¦è´¦æˆ·
        userRepository.delete(secondaryUser);
        
        return MergeResult.success(primaryUserId);
    }
    
    private void mergeUserData(User primary, User secondary) {
        // åˆå¹¶ä¸ªäººä¿¡æ¯ï¼ˆä»¥ä¸»è´¦æˆ·ä¸ºå‡†ï¼Œè¡¥å……ç¼ºå¤±ä¿¡æ¯ï¼‰
        if (primary.getPhoneNumber() == null && secondary.getPhoneNumber() != null) {
            primary.setPhoneNumber(secondary.getPhoneNumber());
        }
        
        if (primary.getAvatarUrl() == null && secondary.getAvatarUrl() != null) {
            primary.setAvatarUrl(secondary.getAvatarUrl());
        }
        
        // åˆå¹¶æƒé™ï¼ˆå–å¹¶é›†ï¼‰
        Set<String> mergedPermissions = new HashSet<>(primary.getPermissions());
        mergedPermissions.addAll(secondary.getPermissions());
        primary.setPermissions(mergedPermissions);
        
        userRepository.save(primary);
    }
}
```

### 6.2 ç¬¬ä¸‰æ–¹å¹³å°é›†æˆç®¡ç†


**ğŸ”¸ æ”¯æŒå¤šå¹³å°ç™»å½•é…ç½®**
```java
// ç¬¬ä¸‰æ–¹ç™»å½•å¹³å°é…ç½®
@Configuration
public class ThirdPartyProviderConfig {
    
    @Bean
    public Map<String, OAuth2ClientProperties> oauth2Providers() {
        return Map.of(
            "google", OAuth2ClientProperties.builder()
                .clientId("${oauth2.google.client-id}")
                .clientSecret("${oauth2.google.client-secret}")
                .redirectUri("/auth/google/callback")
                .scope(List.of("email", "profile"))
                .build(),
                
            "github", OAuth2ClientProperties.builder()
                .clientId("${oauth2.github.client-id}")
                .clientSecret("${oauth2.github.client-secret}")
                .redirectUri("/auth/github/callback")
                .scope(List.of("user:email"))
                .build(),
                
            "wechat", OAuth2ClientProperties.builder()
                .clientId("${oauth2.wechat.app-id}")
                .clientSecret("${oauth2.wechat.app-secret}")
                .redirectUri("/auth/wechat/callback")
                .scope(List.of("snsapi_userinfo"))
                .build()
        );
    }
}

// ç»Ÿä¸€çš„ç¬¬ä¸‰æ–¹ç™»å½•å¤„ç†
@RestController
public class ThirdPartyAuthController {
    
    @GetMapping("/auth/{provider}/login")
    public ResponseEntity<String> initiateLogin(@PathVariable String provider) {
        OAuth2ClientProperties config = getProviderConfig(provider);
        String authUrl = buildAuthorizationUrl(provider, config);
        
        return ResponseEntity.ok(authUrl);
    }
    
    @PostMapping("/auth/{provider}/callback")
    public ResponseEntity<LoginResult> handleCallback(
            @PathVariable String provider,
            @RequestBody CallbackRequest request) {
        
        ThirdPartyUserInfo userInfo = exchangeCodeForUserInfo(provider, request.getCode());
        LoginResult result = thirdPartyBindingService.handleThirdPartyCallback(
            new ThirdPartyCallbackData(provider, userInfo)
        );
        
        return ResponseEntity.ok(result);
    }
}
```

---

## 7. ğŸ“Š è®¡é‡å®¡è®¡ä¸è®¡è´¹è®¾è®¡


### 7.1 ä½¿ç”¨é‡è®¡é‡ç³»ç»Ÿ


**ğŸ”¸ è®¡é‡æ•°æ®æ¨¡å‹**
```java
// ä½¿ç”¨é‡è®¡é‡è®°å½•
@Entity
public class UsageMetrics {
    private String tenantId;
    private String metricType;        // API_CALLS, STORAGE, USERSç­‰
    private Long metricValue;         // ä½¿ç”¨é‡æ•°å€¼
    private String unit;              // å•ä½ï¼šæ¬¡ã€GBã€ä¸ª
    private LocalDateTime recordTime; // è®°å½•æ—¶é—´
    private Map<String, Object> metadata; // é¢å¤–å…ƒæ•°æ®
    
    // è®¡é‡ç±»å‹å®šä¹‰
    public enum MetricType {
        API_CALLS("æ¬¡", "APIè°ƒç”¨æ¬¡æ•°"),
        STORAGE_USED("GB", "å­˜å‚¨ä½¿ç”¨é‡"),
        ACTIVE_USERS("ä¸ª", "æ´»è·ƒç”¨æˆ·æ•°"),
        DATA_TRANSFER("GB", "æ•°æ®ä¼ è¾“é‡"),
        COMPUTE_HOURS("å°æ—¶", "è®¡ç®—èµ„æºä½¿ç”¨æ—¶é—´");
        
        private final String unit;
        private final String description;
    }
}

@Service
public class UsageTrackingService {
    
    // è®°å½•APIè°ƒç”¨
    @EventListener
    public void onApiCall(ApiCallEvent event) {
        recordUsage(event.getTenantId(), 
                   MetricType.API_CALLS, 
                   1L, 
                   Map.of("endpoint", event.getEndpoint(),
                          "method", event.getHttpMethod()));
    }
    
    // è®°å½•å­˜å‚¨ä½¿ç”¨
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿè®°å½•ä¸€æ¬¡
    public void recordStorageUsage() {
        List<Tenant> activeTenants = tenantRepository.findAllActive();
        
        for (Tenant tenant : activeTenants) {
            long storageUsed = calculateStorageUsage(tenant.getTenantId());
            recordUsage(tenant.getTenantId(), 
                       MetricType.STORAGE_USED, 
                       storageUsed, 
                       Map.of("calculatedAt", Instant.now()));
        }
    }
    
    private void recordUsage(String tenantId, MetricType metricType, 
                           Long value, Map<String, Object> metadata) {
        UsageMetrics metrics = UsageMetrics.builder()
            .tenantId(tenantId)
            .metricType(metricType.name())
            .metricValue(value)
            .unit(metricType.getUnit())
            .recordTime(LocalDateTime.now())
            .metadata(metadata)
            .build();
            
        usageMetricsRepository.save(metrics);
    }
}
```

### 7.2 è®¡è´¹æ¨¡å‹è®¾è®¡


**ğŸ”¸ å¤šç§è®¡è´¹ç­–ç•¥**
```java
// è®¡è´¹ç­–ç•¥æ¥å£
public interface BillingStrategy {
    BillingAmount calculateBilling(String tenantId, BillingPeriod period);
}

// å›ºå®šå¥—é¤è®¡è´¹
@Component
public class SubscriptionBillingStrategy implements BillingStrategy {
    
    @Override
    public BillingAmount calculateBilling(String tenantId, BillingPeriod period) {
        Tenant tenant = tenantRepository.findByTenantId(tenantId);
        TenantPlan plan = tenant.getPlan();
        
        // åŸºç¡€å¥—é¤è´¹ç”¨
        BigDecimal baseAmount = getBasePriceByPlan(plan);
        
        // è¶…é‡è´¹ç”¨è®¡ç®—
        BigDecimal overage = calculateOverageFees(tenantId, plan, period);
        
        return BillingAmount.builder()
            .tenantId(tenantId)
            .period(period)
            .baseAmount(baseAmount)
            .overageAmount(overage)
            .totalAmount(baseAmount.add(overage))
            .build();
    }
    
    private BigDecimal calculateOverageFees(String tenantId, TenantPlan plan, BillingPeriod period) {
        // è·å–ä½¿ç”¨é‡
        UsageSummary usage = getUsageSummary(tenantId, period);
        
        BigDecimal overageFees = BigDecimal.ZERO;
        
        // APIè°ƒç”¨è¶…é‡
        if (usage.getApiCalls() > plan.getIncludedApiCalls()) {
            long overageApiCalls = usage.getApiCalls() - plan.getIncludedApiCalls();
            overageFees = overageFees.add(
                BigDecimal.valueOf(overageApiCalls)
                .multiply(plan.getApiCallOverageRate())
            );
        }
        
        // å­˜å‚¨è¶…é‡
        if (usage.getStorageGB() > plan.getIncludedStorageGB()) {
            long overageStorage = usage.getStorageGB() - plan.getIncludedStorageGB();
            overageFees = overageFees.add(
                BigDecimal.valueOf(overageStorage)
                .multiply(plan.getStorageOverageRate())
            );
        }
        
        return overageFees;
    }
}
```

### 7.3 å®¡è®¡æ—¥å¿—ç³»ç»Ÿ


**ğŸ”¸ æ“ä½œå®¡è®¡è®°å½•**
```java
// å®¡è®¡æ—¥å¿—æ¨¡å‹
@Entity
public class AuditLog {
    private String auditId;
    private String tenantId;
    private String userId;
    private String action;            // CREATE, UPDATE, DELETE, LOGINç­‰
    private String resource;          // æ“ä½œçš„èµ„æºç±»å‹
    private String resourceId;        // å…·ä½“èµ„æºID
    private Map<String, Object> beforeData; // æ“ä½œå‰æ•°æ®
    private Map<String, Object> afterData;  // æ“ä½œåæ•°æ®
    private String ipAddress;
    private String userAgent;
    private LocalDateTime timestamp;
    private AuditResult result;       // SUCCESS, FAILURE, UNAUTHORIZED
}

@Component
@Slf4j
public class AuditLogger {
    
    // ä½¿ç”¨AOPè®°å½•æ“ä½œå®¡è®¡
    @Around("@annotation(Auditable)")
    public Object auditOperation(ProceedingJoinPoint joinPoint) throws Throwable {
        String tenantId = TenantContext.getCurrentTenant();
        String userId = SecurityContext.getCurrentUserId();
        
        // è®°å½•æ“ä½œå¼€å§‹
        AuditLog auditLog = AuditLog.builder()
            .auditId(generateAuditId())
            .tenantId(tenantId)
            .userId(userId)
            .action(extractAction(joinPoint))
            .resource(extractResource(joinPoint))
            .timestamp(LocalDateTime.now())
            .build();
        
        try {
            // æ‰§è¡ŒåŸå§‹æ–¹æ³•
            Object result = joinPoint.proceed();
            
            // è®°å½•æˆåŠŸç»“æœ
            auditLog.setResult(AuditResult.SUCCESS);
            auditLog.setAfterData(extractResultData(result));
            
            return result;
        } catch (Exception e) {
            // è®°å½•å¤±è´¥ä¿¡æ¯
            auditLog.setResult(AuditResult.FAILURE);
            auditLog.setErrorMessage(e.getMessage());
            throw e;
        } finally {
            // ä¿å­˜å®¡è®¡æ—¥å¿—
            auditLogRepository.save(auditLog);
        }
    }
}

// å®¡è®¡æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Auditable {
    String action() default "";
    String resource() default "";
    boolean logDataChanges() default false;
}

// ä½¿ç”¨ç¤ºä¾‹
@Service
public class UserService {
    
    @Auditable(action = "CREATE_USER", resource = "USER", logDataChanges = true)
    public User createUser(CreateUserRequest request) {
        // åˆ›å»ºç”¨æˆ·é€»è¾‘
        return userRepository.save(newUser);
    }
    
    @Auditable(action = "UPDATE_USER_ROLE", resource = "USER")
    public void updateUserRole(String userId, String newRole) {
        // æ›´æ–°è§’è‰²é€»è¾‘
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¤šç§Ÿæˆ·ç³»ç»Ÿï¼šä¸€å¥—ç³»ç»ŸæœåŠ¡å¤šä¸ªç§Ÿæˆ·ï¼Œå…±äº«èµ„æºä½†æ•°æ®éš”ç¦»
ğŸ”¸ éš”ç¦»çº§åˆ«ï¼šé€»è¾‘éš”ç¦»ï¼ˆå…±äº«DBï¼‰vs ç‰©ç†éš”ç¦»ï¼ˆç‹¬ç«‹DBï¼‰
ğŸ”¸ ç§Ÿæˆ·æ¨¡å‹ï¼šè®¿å®¢æ¨¡å¼ã€å­è´¦å·æ¨¡å¼ã€ç»„ç»‡ç»“æ„æ¨¡å¼
ğŸ”¸ ä¸Šä¸‹æ–‡ä¼ é€’ï¼šHTTP Headerã€JWT Claimsä¸¤ç§æ–¹å¼
ğŸ”¸ èµ„æºç®¡æ§ï¼šé™æµã€é…é¢ã€æƒé™æ¨¡æ¿çš„ç§Ÿæˆ·çº§ç®¡ç†
ğŸ”¸ è´¦æˆ·ä½“ç³»ï¼šè‡ªåŠ©æ³¨å†Œã€ç¬¬ä¸‰æ–¹ç»‘å®šã€è´¦æˆ·åˆå¹¶
ğŸ”¸ è®¡é‡è®¡è´¹ï¼šä½¿ç”¨é‡è¿½è¸ªã€å¤šç§è®¡è´¹ç­–ç•¥ã€å®¡è®¡åˆè§„
```

### 8.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ ç§Ÿæˆ·éš”ç¦»çš„å®ç°åŸåˆ™**
```
æ•°æ®å®‰å…¨ï¼šç¡®ä¿ç§Ÿæˆ·é—´æ•°æ®å®Œå…¨éš”ç¦»ï¼Œé˜²æ­¢æ•°æ®æ³„æ¼
æ€§èƒ½å‡è¡¡ï¼šé¿å…å•ä¸ªç§Ÿæˆ·å½±å“æ•´ä½“ç³»ç»Ÿæ€§èƒ½
æˆæœ¬æ§åˆ¶ï¼šåœ¨å®‰å…¨å’Œæˆæœ¬é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹
æ‰©å±•æ€§ï¼šæ”¯æŒç§Ÿæˆ·å¿«é€Ÿæ‰©å®¹å’ŒåŠŸèƒ½å‡çº§
```

**ğŸ”¹ ä¸Šä¸‹æ–‡ä¼ é€’æœ€ä½³å®è·µ**
```
å®‰å…¨ä¼ é€’ï¼šç§Ÿæˆ·IDä¸èƒ½ä¼ªé€ ï¼Œéœ€è¦éªŒè¯ä»¤ç‰Œåˆæ³•æ€§
æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼Œé¿å…æ¯æ¬¡æŸ¥è¯¢ä¼ é€’å‚æ•°
å¼‚å¸¸å¤„ç†ï¼šè¯·æ±‚ç»“æŸååŠæ—¶æ¸…ç†ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
å¤šæœåŠ¡ä¼ é€’ï¼šå¾®æœåŠ¡è°ƒç”¨æ—¶è¦é€ä¼ ç§Ÿæˆ·ä¸Šä¸‹æ–‡
```

**ğŸ”¹ è®¡è´¹ç³»ç»Ÿè®¾è®¡è¦ç‚¹**
```
å®æ—¶æ€§ï¼šä½¿ç”¨é‡è¦å®æ—¶æˆ–å‡†å®æ—¶è®°å½•ï¼Œç¡®ä¿è®¡è´¹å‡†ç¡®
å¯æ‰©å±•ï¼šæ”¯æŒå¤šç§è®¡è´¹æ¨¡å¼ï¼Œé€‚åº”ä¸šåŠ¡å‘å±•éœ€è¦
å®¡è®¡æ€§ï¼šæ‰€æœ‰è®¡è´¹ç›¸å…³æ“ä½œè¦æœ‰å®Œæ•´å®¡è®¡è®°å½•
åˆè§„æ€§ï¼šç¬¦åˆè´¢åŠ¡å’Œæ³•å¾‹è¦æ±‚ï¼Œæ”¯æŒå‘ç¥¨å’Œå¯¹è´¦
```

### 8.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ“Š é€‚ç”¨ä¸šåŠ¡ç±»å‹**
- **SaaSå¹³å°**ï¼šCRMã€ERPã€åä½œå·¥å…·ç­‰ä¼ä¸šè½¯ä»¶
- **ç”µå•†å¹³å°**ï¼šæ”¯æŒå¤šå•†å®¶çš„ç”µå•†ç³»ç»Ÿ
- **å†…å®¹å¹³å°**ï¼šæ”¯æŒå¤šæœºæ„çš„å†…å®¹ç®¡ç†ç³»ç»Ÿ
- **å¼€å‘å¹³å°**ï¼šä»£ç æ‰˜ç®¡ã€CI/CDç­‰å¼€å‘å·¥å…·

**ğŸ”§ æŠ€æœ¯é€‰å‹å»ºè®®**
```
å°è§„æ¨¡ï¼ˆ<100ç§Ÿæˆ·ï¼‰ï¼š
â†’ é€»è¾‘éš”ç¦» + MySQLåˆ†åº“
â†’ JWTä¼ é€’ç§Ÿæˆ·ä¿¡æ¯
â†’ ç®€å•çš„é…é¢æ§åˆ¶

ä¸­ç­‰è§„æ¨¡ï¼ˆ100-1000ç§Ÿæˆ·ï¼‰ï¼š
â†’ é€»è¾‘éš”ç¦» + åˆ†åº“åˆ†è¡¨
â†’ Redisç¼“å­˜ç§Ÿæˆ·é…ç½®
â†’ å®Œæ•´çš„è®¡è´¹ç³»ç»Ÿ

å¤§è§„æ¨¡ï¼ˆ>1000ç§Ÿæˆ·ï¼‰ï¼š
â†’ æ··åˆéš”ç¦»ç­–ç•¥
â†’ åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤  
â†’ å®æ—¶è®¡é‡å’Œåˆ†æç³»ç»Ÿ
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- å¤šç§Ÿæˆ·ç³»ç»Ÿçš„æœ¬è´¨æ˜¯**èµ„æºå…±äº«**å’Œ**æ•°æ®éš”ç¦»**çš„å¹³è¡¡
- ç§Ÿæˆ·ä¸Šä¸‹æ–‡ä¼ é€’è¦ä¿è¯**å®‰å…¨æ€§**å’Œ**ä¸€è‡´æ€§**
- è®¡é‡è®¡è´¹ç³»ç»Ÿè¦è€ƒè™‘**å‡†ç¡®æ€§**å’Œ**å¯æ‰©å±•æ€§**
- è´¦æˆ·ä½“ç³»è¦æ”¯æŒ**å¤šæ ·åŒ–**çš„ç™»å½•å’Œæ³¨å†Œæ–¹å¼