---
title: 6ã€LDAPæ•°æ®ç®¡ç†æ“ä½œ
---
## ðŸ“š ç›®å½•

1. [LDAPæ•°æ®ç®¡ç†æ¦‚è¿°](#1-LDAPæ•°æ®ç®¡ç†æ¦‚è¿°)
2. [æ·»åŠ æ¡ç›®æ“ä½œ](#2-æ·»åŠ æ¡ç›®æ“ä½œ)
3. [æŸ¥è¯¢æ¡ç›®æ“ä½œ](#3-æŸ¥è¯¢æ¡ç›®æ“ä½œ)
4. [ä¿®æ”¹æ¡ç›®æ“ä½œ](#4-ä¿®æ”¹æ¡ç›®æ“ä½œ)
5. [åˆ é™¤æ¡ç›®æ“ä½œ](#5-åˆ é™¤æ¡ç›®æ“ä½œ)
6. [LDIFæ–‡ä»¶è¯¦è§£](#6-LDIFæ–‡ä»¶è¯¦è§£)
7. [æ‰¹é‡æ“ä½œæŠ€å·§](#7-æ‰¹é‡æ“ä½œæŠ€å·§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ LDAPæ•°æ®ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯LDAPæ•°æ®ç®¡ç†


**ðŸ’¡ é€šä¿—ç†è§£**
æƒ³è±¡LDAPç›®å½•å°±åƒä¸€ä¸ª**å¤§åž‹é€šè®¯å½•**ï¼Œä½ éœ€è¦èƒ½å¤Ÿï¼š
- ðŸ“ **æ·»åŠ æ–°è”ç³»äºº**ï¼ˆæ·»åŠ æ¡ç›®ï¼‰
- ðŸ” **æŸ¥æ‰¾è”ç³»äºº**ï¼ˆæŸ¥è¯¢æ¡ç›®ï¼‰
- âœï¸ **æ›´æ–°è”ç³»äººä¿¡æ¯**ï¼ˆä¿®æ”¹æ¡ç›®ï¼‰
- ðŸ—‘ï¸ **åˆ é™¤ä¸éœ€è¦çš„è”ç³»äºº**ï¼ˆåˆ é™¤æ¡ç›®ï¼‰

```
ä¼ ç»Ÿæ•°æ®åº“ vs LDAPç›®å½•ï¼š

ðŸ“Š ä¼ ç»Ÿæ•°æ®åº“ï¼ˆå…³ç³»åž‹ï¼‰
â”œâ”€â”€ è¡¨æ ¼ç»“æž„ï¼ˆTableï¼‰
â”œâ”€â”€ è¡Œå’Œåˆ—ï¼ˆRow & Columnï¼‰
â””â”€â”€ SQLè¯­å¥æ“ä½œ

ðŸŒ³ LDAPç›®å½•ï¼ˆæ ‘çŠ¶ç»“æž„ï¼‰
â”œâ”€â”€ ç›®å½•æ ‘ï¼ˆDirectory Treeï¼‰
â”œâ”€â”€ æ¡ç›®å’Œå±žæ€§ï¼ˆEntry & Attributeï¼‰
â””â”€â”€ LDAPå‘½ä»¤æ“ä½œ
```

### 1.2 LDAPæ•°æ®æ“ä½œçš„æ ¸å¿ƒæ¦‚å¿µ


**ðŸ”¸ æ¡ç›®ï¼ˆEntryï¼‰**
```
ä¸€ä¸ªæ¡ç›®å°±æ˜¯ç›®å½•ä¸­çš„ä¸€ä¸ª"è®°å½•"
æ¯”å¦‚ï¼šä¸€ä¸ªç”¨æˆ·ã€ä¸€ä¸ªéƒ¨é—¨ã€ä¸€å°è®¾å¤‡

ç¤ºä¾‹æ¡ç›®ï¼š
dn: uid=zhangsan,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
uid: zhangsan
cn: å¼ ä¸‰
sn: å¼ 
mail: zhangsan@company.com
```

**ðŸ”¸ å±žæ€§ï¼ˆAttributeï¼‰**
```
å±žæ€§å°±æ˜¯æ¡ç›®çš„"å­—æ®µä¿¡æ¯"
- uidï¼šç”¨æˆ·ID
- cnï¼šé€šç”¨åç§°
- mailï¼šé‚®ç®±åœ°å€
- telephoneNumberï¼šç”µè¯å·ç 
```

**ðŸ”¸ DNï¼ˆDistinguished Nameï¼‰**
```
DNå°±æ˜¯æ¡ç›®åœ¨ç›®å½•æ ‘ä¸­çš„"å®Œæ•´åœ°å€"
ç±»ä¼¼äºŽï¼šçœå¸‚åŒºè¡—é“é—¨ç‰Œå·

dn: uid=zhangsan,ou=users,dc=company,dc=com
     â†‘ç”¨æˆ·ID    â†‘ç»„ç»‡å•ä½  â†‘åŸŸåç»„ä»¶
```

---

## 2. ðŸ“ æ·»åŠ æ¡ç›®æ“ä½œ


### 2.1 ldapaddå‘½ä»¤è¯¦è§£


**ðŸ’¡ ä»€ä¹ˆæ˜¯ldapadd**
`ldapadd`å°±æ˜¯å¾€LDAPç›®å½•é‡Œ**æ·»åŠ æ–°æ¡ç›®**çš„å‘½ä»¤ï¼Œå°±åƒå¾€é€šè®¯å½•é‡Œæ·»åŠ æ–°è”ç³»äººä¸€æ ·ã€‚

### 2.2 åŸºæœ¬è¯­æ³•ç»“æž„


```bash
ldapadd [é€‰é¡¹] [å‚æ•°]

å¸¸ç”¨é€‰é¡¹ï¼š
-H  æŒ‡å®šLDAPæœåŠ¡å™¨åœ°å€
-D  æŒ‡å®šç®¡ç†å‘˜DNï¼ˆç”¨ä»€ä¹ˆèº«ä»½ç™»å½•ï¼‰
-w  æŒ‡å®šå¯†ç 
-f  æŒ‡å®šLDIFæ–‡ä»¶
-x  ä½¿ç”¨ç®€å•è®¤è¯
```

### 2.3 å®žé™…æ“ä½œç¤ºä¾‹


**ðŸ”¸ åˆ›å»ºLDIFæ–‡ä»¶ï¼ˆç”¨æˆ·ä¿¡æ¯ï¼‰**
```bash
# åˆ›å»ºæ–°ç”¨æˆ·æ–‡ä»¶ï¼šadd_user.ldif
cat > add_user.ldif << EOF
dn: uid=lisi,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
objectClass: posixAccount
uid: lisi
cn: æŽå››
sn: æŽ
givenName: å››
mail: lisi@company.com
telephoneNumber: 13800138000
uidNumber: 10001
gidNumber: 10001
homeDirectory: /home/lisi
loginShell: /bin/bash
EOF
```

**ðŸ”¸ æ‰§è¡Œæ·»åŠ æ“ä½œ**
```bash
# æ·»åŠ å•ä¸ªç”¨æˆ·
ldapadd -H ldap://192.168.1.10:389 \
        -D "cn=admin,dc=company,dc=com" \
        -w admin123 \
        -f add_user.ldif

# æˆåŠŸè¾“å‡ºç¤ºä¾‹ï¼š
adding new entry "uid=lisi,ou=users,dc=company,dc=com"
```

### 2.4 æ·»åŠ æ“ä½œçš„å®Œæ•´æµç¨‹å›¾


```
å¼€å§‹æ·»åŠ æ¡ç›®
     â†“
å‡†å¤‡LDIFæ–‡ä»¶
     â†“
è¿žæŽ¥LDAPæœåŠ¡å™¨ â† éœ€è¦ç®¡ç†å‘˜æƒé™
     â†“
éªŒè¯æ–‡ä»¶æ ¼å¼ â† æ£€æŸ¥è¯­æ³•æ˜¯å¦æ­£ç¡®
     â†“
æ£€æŸ¥æ¡ç›®æ˜¯å¦å­˜åœ¨ â† é¿å…é‡å¤æ·»åŠ 
     â†“
æ‰§è¡Œæ·»åŠ æ“ä½œ
     â†“
è¿”å›žç»“æžœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
```

### 2.5 å¸¸è§æ·»åŠ åœºæ™¯


**ðŸ”¸ æ‰¹é‡æ·»åŠ ç”¨æˆ·**
```bash
# åˆ›å»ºå¤šç”¨æˆ·LDIFæ–‡ä»¶
cat > batch_users.ldif << EOF
dn: uid=user1,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
uid: user1
cn: ç”¨æˆ·ä¸€
sn: ç”¨æˆ·
mail: user1@company.com

dn: uid=user2,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
uid: user2
cn: ç”¨æˆ·äºŒ
sn: ç”¨æˆ·
mail: user2@company.com
EOF

# æ‰¹é‡æ·»åŠ 
ldapadd -H ldap://localhost -D "cn=admin,dc=company,dc=com" -w password -f batch_users.ldif
```

---

## 3. ðŸ” æŸ¥è¯¢æ¡ç›®æ“ä½œ


### 3.1 ldapsearchå‘½ä»¤è¯¦è§£


**ðŸ’¡ ä»€ä¹ˆæ˜¯ldapsearch**
`ldapsearch`å°±æ˜¯åœ¨LDAPç›®å½•é‡Œ**æŸ¥æ‰¾ä¿¡æ¯**çš„å‘½ä»¤ï¼Œå°±åƒåœ¨é€šè®¯å½•é‡Œæœç´¢è”ç³»äººä¸€æ ·ã€‚

### 3.2 åŸºæœ¬æŸ¥è¯¢è¯­æ³•


```bash
ldapsearch [é€‰é¡¹] [æœç´¢æ¡ä»¶] [è¿”å›žå±žæ€§]

å¸¸ç”¨é€‰é¡¹ï¼š
-H  LDAPæœåŠ¡å™¨åœ°å€
-D  ç»‘å®šDNï¼ˆç”¨ä»€ä¹ˆèº«ä»½æŸ¥è¯¢ï¼‰
-w  å¯†ç 
-b  æœç´¢åŸºå‡†DNï¼ˆä»Žå“ªé‡Œå¼€å§‹æœï¼‰
-s  æœç´¢èŒƒå›´ï¼ˆbase/one/subï¼‰
-x  ç®€å•è®¤è¯
```

### 3.3 æœç´¢èŒƒå›´è¯´æ˜Ž


```
ðŸŒ³ ç›®å½•æ ‘ç»“æž„ï¼š
dc=company,dc=com
â”œâ”€â”€ ou=users
â”‚   â”œâ”€â”€ uid=zhangsan
â”‚   â””â”€â”€ uid=lisi
â””â”€â”€ ou=groups
    â””â”€â”€ cn=developers

æœç´¢èŒƒå›´ç±»åž‹ï¼š
ðŸ“ baseï¼šåªæœç´¢æŒ‡å®šæ¡ç›®æœ¬èº«
ðŸ“ oneï¼šæœç´¢æŒ‡å®šæ¡ç›®çš„ç›´æŽ¥å­æ¡ç›®
ðŸ“ subï¼šæœç´¢æŒ‡å®šæ¡ç›®åŠæ‰€æœ‰å­æ¡ç›®ï¼ˆé»˜è®¤ï¼‰
```

### 3.4 å¸¸ç”¨æŸ¥è¯¢ç¤ºä¾‹


**ðŸ”¸ æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·**
```bash
# æŸ¥è¯¢usersç»„ç»‡ä¸‹çš„æ‰€æœ‰ç”¨æˆ·
ldapsearch -H ldap://localhost:389 \
           -D "cn=admin,dc=company,dc=com" \
           -w password \
           -b "ou=users,dc=company,dc=com" \
           -s sub \
           "(objectClass=inetOrgPerson)"
```

**ðŸ”¸ æŒ‰æ¡ä»¶æŸ¥è¯¢ç”¨æˆ·**
```bash
# æŸ¥è¯¢æŒ‡å®šç”¨æˆ·
ldapsearch -x -b "dc=company,dc=com" "(uid=zhangsan)"

# æŸ¥è¯¢é‚®ç®±åŒ…å«"company"çš„ç”¨æˆ·
ldapsearch -x -b "dc=company,dc=com" "(mail=*company*)"

# æŸ¥è¯¢æŒ‡å®šéƒ¨é—¨çš„ç”¨æˆ·
ldapsearch -x -b "ou=users,dc=company,dc=com" "(ou=IT)"
```

**ðŸ”¸ æŒ‡å®šè¿”å›žå±žæ€§**
```bash
# åªè¿”å›žå§“åå’Œé‚®ç®±
ldapsearch -x -b "dc=company,dc=com" \
           "(uid=zhangsan)" \
           cn mail

# è¿”å›žæ‰€æœ‰å±žæ€§
ldapsearch -x -b "dc=company,dc=com" \
           "(uid=zhangsan)" \
           "*"
```

### 3.5 æŸ¥è¯¢ç»“æžœè§£è¯»


```bash
# æŸ¥è¯¢ç»“æžœç¤ºä¾‹ï¼š
# extended LDIF
#
# LDAPv3
# base <ou=users,dc=company,dc=com> with scope subtree
# filter: (uid=zhangsan)
# requesting: ALL
#

# zhangsan, users, company.com
dn: uid=zhangsan,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
uid: zhangsan
cn: å¼ ä¸‰
sn: å¼ 
mail: zhangsan@company.com
telephoneNumber: 13912345678

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
```

**ç»“æžœè¯´æ˜Žï¼š**
- `numEntries: 1` - æ‰¾åˆ°1ä¸ªæ¡ç›®
- `result: 0 Success` - æŸ¥è¯¢æˆåŠŸ
- ä¸­é—´éƒ¨åˆ†æ˜¯æ‰¾åˆ°çš„æ¡ç›®è¯¦ç»†ä¿¡æ¯

---

## 4. âœï¸ ä¿®æ”¹æ¡ç›®æ“ä½œ


### 4.1 ldapmodifyå‘½ä»¤è¯¦è§£


**ðŸ’¡ ä»€ä¹ˆæ˜¯ldapmodify**
`ldapmodify`å°±æ˜¯**ä¿®æ”¹LDAPæ¡ç›®ä¿¡æ¯**çš„å‘½ä»¤ï¼Œå°±åƒæ›´æ–°é€šè®¯å½•é‡Œè”ç³»äººçš„ç”µè¯å·ç ä¸€æ ·ã€‚

### 4.2 ä¿®æ”¹æ“ä½œç±»åž‹


```
ä¿®æ”¹æ“ä½œç±»åž‹ï¼š

âœï¸ addï¼šæ·»åŠ æ–°å±žæ€§å€¼
ðŸ”„ replaceï¼šæ›¿æ¢çŽ°æœ‰å±žæ€§å€¼  
ðŸ—‘ï¸ deleteï¼šåˆ é™¤å±žæ€§å€¼
```

### 4.3 ä¿®æ”¹è¯­æ³•ç¤ºä¾‹


**ðŸ”¸ æ›¿æ¢å±žæ€§å€¼**
```bash
# åˆ›å»ºä¿®æ”¹æ–‡ä»¶ï¼šmodify_user.ldif
cat > modify_user.ldif << EOF
dn: uid=zhangsan,ou=users,dc=company,dc=com
changetype: modify
replace: mail
mail: zhangsan_new@company.com
-
replace: telephoneNumber
telephoneNumber: 13900000000
EOF

# æ‰§è¡Œä¿®æ”¹
ldapmodify -H ldap://localhost:389 \
           -D "cn=admin,dc=company,dc=com" \
           -w password \
           -f modify_user.ldif
```

**ðŸ”¸ æ·»åŠ æ–°å±žæ€§**
```bash
# æ·»åŠ æè¿°ä¿¡æ¯
cat > add_description.ldif << EOF
dn: uid=zhangsan,ou=users,dc=company,dc=com
changetype: modify
add: description
description: ITéƒ¨é—¨é«˜çº§å·¥ç¨‹å¸ˆ
EOF

ldapmodify -H ldap://localhost -D "cn=admin,dc=company,dc=com" -w password -f add_description.ldif
```

**ðŸ”¸ åˆ é™¤å±žæ€§**
```bash
# åˆ é™¤ç”µè¯å·ç å±žæ€§
cat > delete_phone.ldif << EOF
dn: uid=zhangsan,ou=users,dc=company,dc=com
changetype: modify
delete: telephoneNumber
EOF

ldapmodify -H ldap://localhost -D "cn=admin,dc=company,dc=com" -w password -f delete_phone.ldif
```

### 4.4 ä¿®æ”¹æ“ä½œæµç¨‹å›¾


```
å¼€å§‹ä¿®æ”¹æ“ä½œ
     â†“
å‡†å¤‡ä¿®æ”¹LDIFæ–‡ä»¶
     â†“
æŒ‡å®šchangetype: modify â† å£°æ˜Žè¿™æ˜¯ä¿®æ”¹æ“ä½œ
     â†“
æŒ‡å®šä¿®æ”¹ç±»åž‹ â† add/replace/delete
     â†“
è¿žæŽ¥LDAPæœåŠ¡å™¨
     â†“
éªŒè¯æ¡ç›®æ˜¯å¦å­˜åœ¨
     â†“
æ‰§è¡Œä¿®æ”¹æ“ä½œ
     â†“
è¿”å›žä¿®æ”¹ç»“æžœ
```

### 4.5 æ‰¹é‡ä¿®æ”¹ç¤ºä¾‹


```bash
# æ‰¹é‡ä¿®æ”¹å¤šä¸ªç”¨æˆ·çš„éƒ¨é—¨ä¿¡æ¯
cat > batch_modify.ldif << EOF
dn: uid=user1,ou=users,dc=company,dc=com
changetype: modify
replace: ou
ou: ITéƒ¨é—¨
-

dn: uid=user2,ou=users,dc=company,dc=com
changetype: modify
replace: ou
ou: è´¢åŠ¡éƒ¨é—¨
-

dn: uid=user3,ou=users,dc=company,dc=com
changetype: modify
add: description
description: æ–°å‘˜å·¥
EOF
```

---

## 5. ðŸ—‘ï¸ åˆ é™¤æ¡ç›®æ“ä½œ


### 5.1 ldapdeleteå‘½ä»¤è¯¦è§£


**ðŸ’¡ ä»€ä¹ˆæ˜¯ldapdelete**
`ldapdelete`å°±æ˜¯ä»ŽLDAPç›®å½•é‡Œ**åˆ é™¤æ¡ç›®**çš„å‘½ä»¤ï¼Œå°±åƒä»Žé€šè®¯å½•é‡Œåˆ é™¤ä¸éœ€è¦çš„è”ç³»äººä¸€æ ·ã€‚

### 5.2 åŸºæœ¬åˆ é™¤è¯­æ³•


```bash
ldapdelete [é€‰é¡¹] DN

å¸¸ç”¨é€‰é¡¹ï¼š
-H  LDAPæœåŠ¡å™¨åœ°å€
-D  ç®¡ç†å‘˜DN
-w  å¯†ç 
-r  é€’å½’åˆ é™¤ï¼ˆåˆ é™¤å«æœ‰å­æ¡ç›®çš„æ¡ç›®ï¼‰
-x  ç®€å•è®¤è¯
```

### 5.3 åˆ é™¤æ“ä½œç¤ºä¾‹


**ðŸ”¸ åˆ é™¤å•ä¸ªç”¨æˆ·**
```bash
# åˆ é™¤æŒ‡å®šç”¨æˆ·
ldapdelete -H ldap://localhost:389 \
           -D "cn=admin,dc=company,dc=com" \
           -w password \
           "uid=lisi,ou=users,dc=company,dc=com"

# æˆåŠŸè¾“å‡ºï¼š
# é€šå¸¸æ²¡æœ‰è¾“å‡ºä¿¡æ¯ï¼Œè¡¨ç¤ºåˆ é™¤æˆåŠŸ
```

**ðŸ”¸ æ‰¹é‡åˆ é™¤ç”¨æˆ·**
```bash
# æ–¹æ³•1ï¼šå‘½ä»¤è¡Œç›´æŽ¥åˆ é™¤å¤šä¸ª
ldapdelete -H ldap://localhost \
           -D "cn=admin,dc=company,dc=com" \
           -w password \
           "uid=user1,ou=users,dc=company,dc=com" \
           "uid=user2,ou=users,dc=company,dc=com"

# æ–¹æ³•2ï¼šä½¿ç”¨LDIFæ–‡ä»¶æ‰¹é‡åˆ é™¤
cat > delete_users.ldif << EOF
dn: uid=user1,ou=users,dc=company,dc=com
changetype: delete

dn: uid=user2,ou=users,dc=company,dc=com
changetype: delete
EOF

ldapmodify -H ldap://localhost -D "cn=admin,dc=company,dc=com" -w password -f delete_users.ldif
```

### 5.4 åˆ é™¤æ“ä½œæ³¨æ„äº‹é¡¹


```
âš ï¸ åˆ é™¤æ³¨æ„äº‹é¡¹ï¼š

ðŸ”¸ æƒé™æ£€æŸ¥ï¼šå¿…é¡»æœ‰è¶³å¤Ÿçš„æƒé™æ‰èƒ½åˆ é™¤
ðŸ”¸ ä¾èµ–å…³ç³»ï¼šåˆ é™¤å‰æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ¡ç›®ä¾èµ–
ðŸ”¸ å­æ¡ç›®ï¼šå«æœ‰å­æ¡ç›®çš„æ¡ç›®éœ€è¦ç”¨-rå‚æ•°é€’å½’åˆ é™¤
ðŸ”¸ å¤‡ä»½æ•°æ®ï¼šåˆ é™¤å‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ®
```

**ðŸ”¸ é€’å½’åˆ é™¤ç¤ºä¾‹**
```bash
# åˆ é™¤æ•´ä¸ªç»„ç»‡å•ä½ï¼ˆåŒ…æ‹¬æ‰€æœ‰å­æ¡ç›®ï¼‰
ldapdelete -r \
           -H ldap://localhost:389 \
           -D "cn=admin,dc=company,dc=com" \
           -w password \
           "ou=temp,dc=company,dc=com"
```

### 5.5 åˆ é™¤æ“ä½œæµç¨‹å›¾


```
å¼€å§‹åˆ é™¤æ“ä½œ
     â†“
éªŒè¯ç”¨æˆ·æƒé™ â† å¿…é¡»æœ‰åˆ é™¤æƒé™
     â†“
æ£€æŸ¥æ¡ç›®æ˜¯å¦å­˜åœ¨
     â†“
æ£€æŸ¥æ˜¯å¦æœ‰å­æ¡ç›® â† å†³å®šæ˜¯å¦éœ€è¦é€’å½’åˆ é™¤
     â†“
æ‰§è¡Œåˆ é™¤æ“ä½œ
     â†“
æ›´æ–°ç›®å½•ç´¢å¼•
     â†“
è¿”å›žåˆ é™¤ç»“æžœ
```

---

## 6. ðŸ“„ LDIFæ–‡ä»¶è¯¦è§£


### 6.1 ä»€ä¹ˆæ˜¯LDIFæ–‡ä»¶


**ðŸ’¡ é€šä¿—ç†è§£**
**LDIFï¼ˆLDAP Data Interchange Formatï¼‰**å°±æ˜¯LDAPæ•°æ®äº¤æ¢æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºï¼š
- ðŸ“ **LDAPçš„"é…ç½®æ–‡ä»¶"** - ç”¨æ–‡æœ¬æè¿°ç›®å½•æ•°æ®
- ðŸ“‹ **æ•°æ®çš„"è¯´æ˜Žä¹¦"** - å‘Šè¯‰LDAPæ€Žä¹ˆå¤„ç†æ•°æ®
- ðŸ”„ **å¯¼å…¥å¯¼å‡ºçš„"ä¸­è½¬ç«™"** - åœ¨ä¸åŒç³»ç»Ÿé—´ä¼ è¾“æ•°æ®

### 6.2 LDIFæ–‡ä»¶åŸºæœ¬ç»“æž„


```bash
# LDIFæ–‡ä»¶ç»“æž„ç¤ºä¾‹
# æ³¨é‡Šè¡Œä»¥#å¼€å¤´

# æ¡ç›®1
dn: uid=zhangsan,ou=users,dc=company,dc=com  â† æ¡ç›®çš„å”¯ä¸€æ ‡è¯†
objectClass: inetOrgPerson                   â† å¯¹è±¡ç±»åž‹
objectClass: posixAccount                    â† å¯ä»¥æœ‰å¤šä¸ªå¯¹è±¡ç±»
uid: zhangsan                                â† ç”¨æˆ·IDå±žæ€§
cn: å¼ ä¸‰                                     â† é€šç”¨åç§°
sn: å¼                                       â† å§“æ°
givenName: ä¸‰                               â† åå­—
mail: zhangsan@company.com                  â† é‚®ç®±
telephoneNumber: 13912345678                â† ç”µè¯

# ç©ºè¡Œåˆ†éš”ä¸åŒæ¡ç›®

# æ¡ç›®2
dn: uid=lisi,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
uid: lisi
cn: æŽå››
...
```

### 6.3 LDIFè¯­æ³•è§„åˆ™è¯¦è§£


**ðŸ”¸ åŸºæœ¬è¯­æ³•è§„åˆ™**
```bash
# 1. æ¯è¡Œä¸€ä¸ªå±žæ€§å€¼å¯¹
attribute: value

# 2. é•¿è¡Œå¯ä»¥ç”¨ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ç»­è¡Œ
description: è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿å¾ˆé•¿çš„æè¿°ä¿¡æ¯ï¼Œ
 éœ€è¦åˆ†æˆå¤šè¡Œæ¥å†™ï¼Œç»­è¡Œç”¨ç©ºæ ¼å¼€å¤´

# 3. ç‰¹æ®Šå­—ç¬¦éœ€è¦Base64ç¼–ç 
cn:: 5byg5LiJICDkuK3mlocK    â† Base64ç¼–ç çš„ä¸­æ–‡

# 4. äºŒè¿›åˆ¶æ•°æ®ç”¨::è¡¨ç¤º
jpegPhoto:: /9j/4AAQSkZJRgABAQEA...

# 5. ç©ºè¡Œåˆ†éš”ä¸åŒæ¡ç›®
dn: ...
attribute: value

dn: ...    â† æ–°æ¡ç›®å¼€å§‹
```

**ðŸ”¸ æ“ä½œç±»åž‹æ ‡è®°**
```bash
# æ·»åŠ æ“ä½œï¼ˆé»˜è®¤ï¼‰
dn: uid=newuser,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
uid: newuser

# ä¿®æ”¹æ“ä½œ
dn: uid=zhangsan,ou=users,dc=company,dc=com
changetype: modify        â† å£°æ˜Žè¿™æ˜¯ä¿®æ”¹æ“ä½œ
replace: mail             â† ä¿®æ”¹ç±»åž‹
mail: new_email@company.com
-                        â† ç»“æŸæ ‡è®°

# åˆ é™¤æ“ä½œ  
dn: uid=olduser,ou=users,dc=company,dc=com
changetype: delete       â† å£°æ˜Žè¿™æ˜¯åˆ é™¤æ“ä½œ
```

### 6.4 LDIFæ–‡ä»¶ç¼–å†™æœ€ä½³å®žè·µ


**ðŸ”¸ æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯**
```bash
# åˆ›å»ºæ ‡å‡†LDIFæ–‡ä»¶
cat > standard.ldif << EOF
# LDIFæ–‡ä»¶ï¼šç”¨æˆ·æ•°æ®å¯¼å…¥
# åˆ›å»ºæ—¶é—´ï¼š2025-01-15
# ä½œç”¨ï¼šæ‰¹é‡å¯¼å…¥å…¬å¸å‘˜å·¥ä¿¡æ¯
# ç‰ˆæœ¬ï¼š1.0

version: 1    â† LDIFç‰ˆæœ¬å£°æ˜Žï¼ˆå¯é€‰ï¼‰

# åŸºç¡€ç›®å½•ç»“æž„
dn: dc=company,dc=com
objectClass: top
objectClass: domain
dc: company

dn: ou=users,dc=company,dc=com
objectClass: top
objectClass: organizationalUnit
ou: users
description: ç”¨æˆ·å­˜å‚¨åŒºåŸŸ

# ç”¨æˆ·æ•°æ®
dn: uid=admin,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
objectClass: posixAccount
uid: admin
cn: ç³»ç»Ÿç®¡ç†å‘˜
...
EOF
```

### 6.5 LDIFæ–‡ä»¶éªŒè¯ä¸Žè°ƒè¯•


**ðŸ”¸ éªŒè¯LDIFæ–‡ä»¶è¯­æ³•**
```bash
# ä½¿ç”¨ldapaddçš„-nå‚æ•°è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼ˆä¸å®žé™…æ‰§è¡Œï¼‰
ldapadd -n -f test.ldif

# ä½¿ç”¨slaptestå·¥å…·éªŒè¯ï¼ˆOpenLDAPï¼‰
slaptest -f /etc/ldap/slapd.conf -l test.ldif
```

**ðŸ”¸ å¸¸è§LDIFé”™è¯¯**
```bash
âŒ å¸¸è§é”™è¯¯ç±»åž‹ï¼š

1. ç¼ºå°‘å¿…éœ€å±žæ€§
dn: uid=test,ou=users,dc=company,dc=com
objectClass: inetOrgPerson
uid: test
# âŒ ç¼ºå°‘cnå’Œsnå±žæ€§ï¼ˆinetOrgPersonçš„å¿…éœ€å±žæ€§ï¼‰

2. DNæ ¼å¼é”™è¯¯  
dn: uid=test ou=users,dc=company,dc=com  # âŒ ç¼ºå°‘é€—å·

3. å±žæ€§å€¼æ ¼å¼é”™è¯¯
telephoneNumber: 138-0000-0000  # âŒ å¯èƒ½ä¸ç¬¦åˆschemaè§„èŒƒ

4. ç¼–ç é—®é¢˜
cn: å¼ ä¸‰  # âŒ ä¸­æ–‡å­—ç¬¦åº”è¯¥ç”¨Base64ç¼–ç æˆ–UTF-8
```

---

## 7. ðŸ“¦ æ‰¹é‡æ“ä½œæŠ€å·§


### 7.1 æ‰¹é‡å¯¼å…¥æŠ€å·§


**ðŸ’¡ ä»€ä¹ˆæ˜¯æ‰¹é‡å¯¼å…¥**
æ‰¹é‡å¯¼å…¥å°±æ˜¯**ä¸€æ¬¡æ€§æ·»åŠ å¤§é‡æ•°æ®**åˆ°LDAPç›®å½•ä¸­ï¼Œå°±åƒæ‰¹é‡å¯¼å…¥é€šè®¯å½•è”ç³»äººä¸€æ ·ã€‚

**ðŸ”¸ å¤§æ–‡ä»¶åˆ†å—å¯¼å…¥**
```bash
# å°†å¤§LDIFæ–‡ä»¶åˆ†æˆå°å—
split -l 1000 large_users.ldif user_chunk_

# åˆ†åˆ«å¯¼å…¥å„ä¸ªå—
for file in user_chunk_*; do
    echo "æ­£åœ¨å¯¼å…¥: $file"
    ldapadd -H ldap://localhost \
            -D "cn=admin,dc=company,dc=com" \
            -w password \
            -f "$file"
    
    if [ $? -eq 0 ]; then
        echo "âœ… $file å¯¼å…¥æˆåŠŸ"
    else
        echo "âŒ $file å¯¼å…¥å¤±è´¥"
    fi
done
```

**ðŸ”¸ å®¹é”™å¯¼å…¥è„šæœ¬**
```bash
#!/bin/bash
# å®¹é”™æ‰¹é‡å¯¼å…¥è„šæœ¬

LDIF_FILE="users.ldif"
LOG_FILE="import_$(date +%Y%m%d_%H%M%S).log"

echo "å¼€å§‹æ‰¹é‡å¯¼å…¥..." | tee $LOG_FILE

# é€æ¡å¯¼å…¥ï¼Œè·³è¿‡é”™è¯¯æ¡ç›®
ldapsearch -H ldap://localhost -D "cn=admin,dc=company,dc=com" -w password -b "" -s base >> $LOG_FILE 2>&1

if ldapadd -H ldap://localhost \
           -D "cn=admin,dc=company,dc=com" \
           -w password \
           -c \  # å‡ºé”™æ—¶ç»§ç»­æ‰§è¡Œ
           -f $LDIF_FILE >> $LOG_FILE 2>&1; then
    echo "âœ… æ‰¹é‡å¯¼å…¥å®Œæˆï¼Œè¯¦æƒ…æŸ¥çœ‹: $LOG_FILE"
else
    echo "âš ï¸ å¯¼å…¥è¿‡ç¨‹ä¸­æœ‰é”™è¯¯ï¼Œè¯¦æƒ…æŸ¥çœ‹: $LOG_FILE"
fi
```

### 7.2 æ‰¹é‡å¯¼å‡ºæŠ€å·§


**ðŸ”¸ å®Œæ•´ç›®å½•å¯¼å‡º**
```bash
# å¯¼å‡ºæ•´ä¸ªç›®å½•ç»“æž„å’Œæ•°æ®
ldapsearch -H ldap://localhost:389 \
           -D "cn=admin,dc=company,dc=com" \
           -w password \
           -b "dc=company,dc=com" \
           -s sub \
           "(objectClass=*)" \
           "*" "+" > full_backup.ldif

# æŒ‰ç»„ç»‡å¯¼å‡º
ldapsearch -x -b "ou=users,dc=company,dc=com" \
           "(objectClass=*)" > users_backup.ldif
```

**ðŸ”¸ é€‰æ‹©æ€§å¯¼å‡º**
```bash
# åªå¯¼å‡ºç”¨æˆ·è´¦å·ä¿¡æ¯
ldapsearch -H ldap://localhost \
           -D "cn=admin,dc=company,dc=com" \
           -w password \
           -b "dc=company,dc=com" \
           "(objectClass=inetOrgPerson)" \
           uid cn sn mail telephoneNumber > users_only.ldif

# å¯¼å‡ºæœ€è¿‘ä¿®æ”¹çš„æ¡ç›®
ldapsearch -x -b "dc=company,dc=com" \
           "(&(objectClass=inetOrgPerson)(modifyTimestamp>=20250101000000Z))" > recent_users.ldif
```

### 7.3 æ•°æ®è¿ç§»æœ€ä½³å®žè·µ


**ðŸ”¸ å®Œæ•´è¿ç§»æµç¨‹**
```bash
# æ­¥éª¤1ï¼šæºç³»ç»Ÿæ•°æ®å¯¼å‡º
echo "ðŸ”¸ ç¬¬1æ­¥ï¼šå¯¼å‡ºæºæ•°æ®..."
ldapsearch -H ldap://old-server:389 \
           -D "cn=admin,dc=old,dc=com" \
           -w oldpassword \
           -b "dc=old,dc=com" \
           -s sub "(objectClass=*)" > source_data.ldif

# æ­¥éª¤2ï¼šæ•°æ®æ ¼å¼è½¬æ¢ï¼ˆå¦‚éœ€è¦ï¼‰
echo "ðŸ”¸ ç¬¬2æ­¥ï¼šè½¬æ¢æ•°æ®æ ¼å¼..."
sed 's/dc=old,dc=com/dc=new,dc=com/g' source_data.ldif > converted_data.ldif

# æ­¥éª¤3ï¼šéªŒè¯ç›®æ ‡ç³»ç»Ÿè¿žæŽ¥
echo "ðŸ”¸ ç¬¬3æ­¥ï¼šéªŒè¯ç›®æ ‡ç³»ç»Ÿ..."
ldapsearch -H ldap://new-server:389 \
           -D "cn=admin,dc=new,dc=com" \
           -w newpassword \
           -b "" -s base > /dev/null 2>&1

if [ $? -eq 0 ]; then
    echo "âœ… ç›®æ ‡ç³»ç»Ÿè¿žæŽ¥æ­£å¸¸"
else
    echo "âŒ ç›®æ ‡ç³»ç»Ÿè¿žæŽ¥å¤±è´¥"
    exit 1
fi

# æ­¥éª¤4ï¼šå¯¼å…¥æ–°ç³»ç»Ÿ
echo "ðŸ”¸ ç¬¬4æ­¥ï¼šå¯¼å…¥æ•°æ®..."
ldapadd -H ldap://new-server:389 \
        -D "cn=admin,dc=new,dc=com" \
        -w newpassword \
        -c \
        -f converted_data.ldif

echo "ðŸŽ‰ æ•°æ®è¿ç§»å®Œæˆ"
```

### 7.4 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**ðŸ”¸ æé«˜å¯¼å…¥æ€§èƒ½**
```bash
# 1. ä½¿ç”¨æœ¬åœ°æ–‡ä»¶è€Œéžç½‘ç»œæ–‡ä»¶
cp remote_file.ldif /tmp/local_file.ldif

# 2. å…³é—­ä¸å¿…è¦çš„æ—¥å¿—
# åœ¨slapd.confä¸­ä¸´æ—¶è®¾ç½®ï¼š
# loglevel none

# 3. ä½¿ç”¨æ‰¹é‡æäº¤
ldapadd -H ldap://localhost \
        -D "cn=admin,dc=company,dc=com" \
        -w password \
        -c \              # å‡ºé”™ç»§ç»­
        -v \              # è¯¦ç»†è¾“å‡º
        -f large_data.ldif

# 4. å¹¶è¡Œå¯¼å…¥ï¼ˆå°å¿ƒä½¿ç”¨ï¼‰
split -l 500 data.ldif chunk_
for file in chunk_*; do
    ldapadd -H ldap://localhost -D "cn=admin,dc=company,dc=com" -w password -f "$file" &
done
wait  # ç­‰å¾…æ‰€æœ‰åŽå°ä»»åŠ¡å®Œæˆ
```

### 7.5 æ‰¹é‡æ“ä½œç›‘æŽ§


**ðŸ”¸ æ“ä½œè¿›åº¦ç›‘æŽ§**
```bash
#!/bin/bash
# æ‰¹é‡æ“ä½œè¿›åº¦ç›‘æŽ§è„šæœ¬

LDIF_FILE="$1"
TOTAL_ENTRIES=$(grep -c "^dn:" "$LDIF_FILE")

echo "ðŸ“Š æ€»å…±éœ€è¦å¤„ç† $TOTAL_ENTRIES ä¸ªæ¡ç›®"

# ä½¿ç”¨pvæ˜¾ç¤ºè¿›åº¦ï¼ˆéœ€è¦å®‰è£…pvå·¥å…·ï¼‰
if command -v pv &> /dev/null; then
    pv "$LDIF_FILE" | ldapadd -H ldap://localhost \
                              -D "cn=admin,dc=company,dc=com" \
                              -w password
else
    # æ‰‹åŠ¨è¿›åº¦æ˜¾ç¤º
    {
        i=0
        while IFS= read -r line; do
            echo "$line"
            if [[ "$line" == dn:* ]]; then
                ((i++))
                if ((i % 100 == 0)); then
                    echo "ðŸ“ˆ å·²å¤„ç† $i/$TOTAL_ENTRIES æ¡ç›® ($(( i * 100 / TOTAL_ENTRIES ))%)" >&2
                fi
            fi
        done < "$LDIF_FILE"
    } | ldapadd -H ldap://localhost -D "cn=admin,dc=company,dc=com" -w password
fi
```

---

## 8. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ“ä½œ


```
ðŸŽ¯ å››å¤§åŸºç¡€æ“ä½œï¼š

ðŸ“ ldapaddï¼šæ·»åŠ æ¡ç›®ï¼ˆå¢žï¼‰
   â””â”€â”€ ç”¨LDIFæ–‡ä»¶æ‰¹é‡æ·»åŠ ç”¨æˆ·ã€ç»„ç»‡ç­‰

ðŸ” ldapsearchï¼šæŸ¥è¯¢æ¡ç›®ï¼ˆæŸ¥ï¼‰  
   â””â”€â”€ æŒ‰æ¡ä»¶æœç´¢ï¼Œæ”¯æŒå„ç§è¿‡æ»¤å™¨

âœï¸ ldapmodifyï¼šä¿®æ”¹æ¡ç›®ï¼ˆæ”¹ï¼‰
   â””â”€â”€ æ”¯æŒadd/replace/deleteä¸‰ç§ä¿®æ”¹ç±»åž‹

ðŸ—‘ï¸ ldapdeleteï¼šåˆ é™¤æ¡ç›®ï¼ˆåˆ ï¼‰
   â””â”€â”€ æ”¯æŒå•ä¸ªåˆ é™¤å’Œé€’å½’åˆ é™¤
```

### 8.2 LDIFæ–‡ä»¶å…³é”®è¦ç‚¹


**ðŸ”¸ LDIFè¯­æ³•è¦ç‚¹**
- âœ… æ¯ä¸ªæ¡ç›®ä»¥`dn:`å¼€å¤´
- âœ… å±žæ€§æ ¼å¼ï¼š`å±žæ€§å: å±žæ€§å€¼`
- âœ… ç©ºè¡Œåˆ†éš”ä¸åŒæ¡ç›®
- âœ… ä¿®æ”¹æ“ä½œéœ€è¦`changetype:`å£°æ˜Ž
- âœ… ä¸­æ–‡ç­‰ç‰¹æ®Šå­—ç¬¦éœ€è¦Base64ç¼–ç 

**ðŸ”¸ å¸¸ç”¨åœºæ™¯æ¨¡æ¿**
```bash
# æ·»åŠ ç”¨æˆ·æ¨¡æ¿
dn: uid={username},ou=users,dc=company,dc=com
objectClass: inetOrgPerson
objectClass: posixAccount
uid: {username}
cn: {fullname}
sn: {surname}
mail: {username}@company.com

# ä¿®æ”¹æ¨¡æ¿
dn: uid={username},ou=users,dc=company,dc=com
changetype: modify
replace: mail
mail: {new_email}
```

### 8.3 å®žç”¨æ“ä½œæŠ€å·§


**ðŸ”¸ å‘½ä»¤è¡ŒæŠ€å·§**
```bash
# å¿«é€Ÿè¯­æ³•ï¼š
ldapadd -x -D "admin_dn" -w password -f file.ldif

# è°ƒè¯•æ¨¡å¼ï¼š
ldapadd -x -D "admin_dn" -w password -v -f file.ldif

# ä»…æ£€æŸ¥è¯­æ³•ï¼š
ldapadd -n -f file.ldif
```

**ðŸ”¸ æ‰¹é‡æ“ä½œæœ€ä½³å®žè·µ**
- âœ… å¤§æ–‡ä»¶åˆ†å—å¤„ç†
- âœ… ä½¿ç”¨å®¹é”™æ¨¡å¼ï¼ˆ`-c`å‚æ•°ï¼‰
- âœ… è®°å½•æ“ä½œæ—¥å¿—
- âœ… æ“ä½œå‰å¤‡ä»½æ•°æ®
- âœ… éªŒè¯æ•°æ®å®Œæ•´æ€§

### 8.4 æ•…éšœæŽ’æŸ¥è¦ç‚¹


**ðŸ”¸ å¸¸è§é”™è¯¯åŠè§£å†³**

| é”™è¯¯ç±»åž‹ | ç—‡çŠ¶ | è§£å†³æ–¹æ³• |
|---------|------|----------|
| ðŸ” **è®¤è¯å¤±è´¥** | `Invalid credentials` | æ£€æŸ¥DNå’Œå¯†ç  |
| ðŸ“ **è¯­æ³•é”™è¯¯** | `Invalid syntax` | éªŒè¯LDIFæ ¼å¼ |
| ðŸ” **æ¡ç›®ä¸å­˜åœ¨** | `No such object` | ç¡®è®¤DNè·¯å¾„æ­£ç¡® |
| âž• **é‡å¤æ·»åŠ ** | `Already exists` | æ£€æŸ¥æ¡ç›®æ˜¯å¦å·²å­˜åœ¨ |
| ðŸ”’ **æƒé™ä¸è¶³** | `Insufficient access` | ç¡®è®¤æ“ä½œæƒé™ |

### 8.5 æ—¥å¸¸è¿ç»´å»ºè®®


**ðŸ”¸ æ“ä½œå‰æ£€æŸ¥æ¸…å•**
- â˜‘ï¸ ç¡®è®¤LDAPæœåŠ¡å™¨çŠ¶æ€
- â˜‘ï¸ éªŒè¯ç®¡ç†å‘˜æƒé™
- â˜‘ï¸ æ£€æŸ¥LDIFæ–‡ä»¶è¯­æ³•
- â˜‘ï¸ å¤‡ä»½é‡è¦æ•°æ®
- â˜‘ï¸ æµ‹è¯•å°‘é‡æ•°æ®å…ˆ

**ðŸ”¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
- ðŸ”’ ç®¡ç†å‘˜å¯†ç ä¸è¦æ˜Žæ–‡å­˜å‚¨åœ¨è„šæœ¬ä¸­
- ðŸ”’ ä½¿ç”¨SSL/TLSåŠ å¯†è¿žæŽ¥ï¼ˆldaps://ï¼‰
- ðŸ”’ é™åˆ¶ç®¡ç†å‘˜è´¦å·ä½¿ç”¨èŒƒå›´
- ðŸ”’ å®šæœŸå®¡è®¡æ“ä½œæ—¥å¿—
- ðŸ”’ å¤‡ä»½æ•°æ®åŠ å¯†å­˜å‚¨

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
LDAPæ“ä½œæœ‰å››æ ·ï¼šå¢žåˆ æ”¹æŸ¥è¦è®°ç‰¢
LDIFæ ¼å¼å¾ˆé‡è¦ï¼šDNå¼€å¤´å±žæ€§è·Ÿ
æ‰¹é‡æ“ä½œéœ€è°¨æ…Žï¼šå¤‡ä»½å®¹é”™ä¿å®‰å…¨
```