---
title: 4ã€è‡ªå®šä¹‰Tokenè®¾è®¡
---
## ğŸ“š ç›®å½•


1. [Tokenè®¾è®¡åŸºç¡€æ¦‚å¿µ](#1-Tokenè®¾è®¡åŸºç¡€æ¦‚å¿µ)
2. [Tokenæ ¼å¼è®¾è®¡](#2-Tokenæ ¼å¼è®¾è®¡)
3. [åŠ å¯†Tokenå®ç°](#3-åŠ å¯†Tokenå®ç°)
4. [ç­¾åTokenæœºåˆ¶](#4-ç­¾åTokenæœºåˆ¶)
5. [å¤åˆTokenæ¶æ„](#5-å¤åˆTokenæ¶æ„)
6. [Tokenæ± åŒ–ä¼˜åŒ–](#6-Tokenæ± åŒ–ä¼˜åŒ–)
7. [å®‰å…¨å¢å¼ºç­–ç•¥](#7-å®‰å…¨å¢å¼ºç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# 1. ğŸ¯ Tokenè®¾è®¡åŸºç¡€æ¦‚å¿µ



## 1.1 ä»€ä¹ˆæ˜¯Tokenï¼Ÿ



**ğŸ”¸ ç®€å•ç†è§£**
Tokenå°±åƒæ˜¯**è¿›å…¥å•†åœºçš„ä¸´æ—¶æ‰‹ç‰Œ**ï¼Œä½ æ‹¿ç€è¿™ä¸ªæ‰‹ç‰Œå°±è¯æ˜ä½ æœ‰æƒé™åœ¨å•†åœºé‡Œæ´»åŠ¨ã€‚

```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
æ¸¸ä¹å›­æ‰‹ç¯ â•â•â•â–¶ è¯æ˜ä½ ä¹°äº†é—¨ç¥¨ï¼Œå¯ä»¥ç©å„ç§é¡¹ç›®
åœè½¦åœºå¡ç‰‡ â•â•â•â–¶ è¯æ˜ä½ äº¤äº†è´¹ï¼Œå¯ä»¥åœè½¦
ä¼šå‘˜ç§¯åˆ†å¡ â•â•â•â–¶ è¯æ˜ä½ çš„èº«ä»½ï¼Œå¯ä»¥äº«å—ä¼˜æƒ 

ç½‘ç»œåº”ç”¨ä¸­ï¼š
ç™»å½•Token â•â•â•â–¶ è¯æ˜ä½ å·²ç™»å½•ï¼Œå¯ä»¥è®¿é—®ç³»ç»ŸåŠŸèƒ½
API Token â•â•â•â–¶ è¯æ˜ä½ æœ‰æƒé™ï¼Œå¯ä»¥è°ƒç”¨æ¥å£
è®¿é—®Token â•â•â•â–¶ è¯æ˜ä½ çš„èº«ä»½ï¼Œå¯ä»¥è·å–èµ„æº
```

**ğŸ”¸ Tokençš„æœ¬è´¨ä½œç”¨**
- **èº«ä»½è¯æ˜**ï¼šæˆ‘æ˜¯è°ï¼ˆWho am Iï¼‰
- **æƒé™å‡­è¯**ï¼šæˆ‘èƒ½åšä»€ä¹ˆï¼ˆWhat can I doï¼‰
- **çŠ¶æ€æ ‡è¯†**ï¼šæˆ‘å½“å‰çš„çŠ¶æ€ï¼ˆWhat's my statusï¼‰

## 1.2 ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰Tokenï¼Ÿ



**ğŸ¤” ç°æœ‰æ–¹æ¡ˆçš„å±€é™æ€§**

```
ğŸ”¸ ä½¿ç”¨Sessionçš„é—®é¢˜ï¼š
   ç”¨æˆ·ç™»å½• â”€â”€â–¶ æœåŠ¡å™¨å­˜å‚¨Session â”€â”€â–¶ å ç”¨æœåŠ¡å™¨å†…å­˜
   å¤šå°æœåŠ¡å™¨ â”€â”€â–¶ Sessionå…±äº«å›°éš¾ â”€â”€â–¶ æ‰©å±•æ€§å·®

ğŸ”¸ ä½¿ç”¨æ ‡å‡†JWTçš„é—®é¢˜ï¼š
   ä¿¡æ¯æš´éœ² â”€â”€â–¶ Base64å¯è§£ç  â”€â”€â–¶ æ•æ„Ÿä¿¡æ¯æ³„éœ²
   æ— æ³•æ’¤é”€ â”€â”€â–¶ æœ‰æ•ˆæœŸå†…æ— æ³•åºŸé™¤ â”€â”€â–¶ å®‰å…¨é£é™©

ğŸ”¸ ç®€å•éšæœºTokençš„é—®é¢˜ï¼š
   æ— çŠ¶æ€ä¿¡æ¯ â”€â”€â–¶ éœ€è¦é¢‘ç¹æŸ¥åº“ â”€â”€â–¶ æ€§èƒ½å¼€é”€å¤§
   ç¼ºä¹éªŒè¯ â”€â”€â–¶ å®¹æ˜“è¢«ä¼ªé€  â”€â”€â–¶ å®‰å…¨æ€§ä½
```

**âœ… è‡ªå®šä¹‰Tokençš„ä¼˜åŠ¿**
- **çµæ´»å¯æ§**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶æ ¼å¼å’Œå†…å®¹
- **å®‰å…¨å¯é **ï¼šå¯ä»¥æ·»åŠ å¤šå±‚å®‰å…¨éªŒè¯æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯ä»¥å†…åµŒå…³é”®ä¿¡æ¯ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- **æ‰©å±•æ€§å¼º**ï¼šå¯ä»¥éšä¸šåŠ¡å‘å±•è°ƒæ•´å’Œå‡çº§

---

# 2. ğŸ“‹ Tokenæ ¼å¼è®¾è®¡



## 2.1 ç»“æ„åŒ– vs éç»“æ„åŒ–



**ğŸ”¸ éç»“æ„åŒ–Tokenï¼ˆéšæœºå­—ç¬¦ä¸²ï¼‰**

```java
// ç®€å•çš„éšæœºToken
String token = UUID.randomUUID().toString().replace("-", "");
// ç»“æœï¼ša1b2c3d4e5f6789012345abcdef67890

ä¼˜ç‚¹ï¼š
âœ… å®ç°ç®€å•ï¼Œç”Ÿæˆé€Ÿåº¦å¿«
âœ… å®Œå…¨éšæœºï¼Œæ— è§„å¾‹å¯å¾ª
âœ… é•¿åº¦å›ºå®šï¼Œå­˜å‚¨æ–¹ä¾¿

ç¼ºç‚¹ï¼š
âŒ ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ï¼Œå¿…é¡»æŸ¥åº“éªŒè¯
âŒ æ— æ³•åŒºåˆ†Tokenç±»å‹å’Œç”¨é€”
âŒ éš¾ä»¥å®ç°å¤æ‚çš„æƒé™æ§åˆ¶
```

**ğŸ”¸ ç»“æ„åŒ–Tokenï¼ˆåŒ…å«ä¿¡æ¯ï¼‰**

```java
// ç»“æ„åŒ–Tokenè®¾è®¡
// æ ¼å¼ï¼šç±»å‹_ç”¨æˆ·ID_æ—¶é—´æˆ³_éšæœºæ•°_æ ¡éªŒç 
// ç¤ºä¾‹ï¼šLOGIN_12345_1691836800_abc123_def456

public class StructuredToken {
    private String type;        // ç±»å‹ï¼šLOGIN, API, REFRESHç­‰
    private Long userId;        // ç”¨æˆ·ID
    private Long timestamp;     // ç”Ÿæˆæ—¶é—´æˆ³
    private String randomPart;  // éšæœºéƒ¨åˆ†
    private String checksum;    // æ ¡éªŒç 
    
    public String generate() {
        return String.format("%s_%d_%d_%s_%s", 
            type, userId, timestamp, randomPart, checksum);
    }
}

ä¼˜ç‚¹ï¼š
âœ… åŒ…å«åŸºæœ¬ä¿¡æ¯ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
âœ… å¯ä»¥å¿«é€Ÿè¯†åˆ«Tokenç±»å‹
âœ… ä¾¿äºå®ç°è¿‡æœŸæ£€æŸ¥å’Œæƒé™æ§åˆ¶
âœ… æ”¯æŒä¸åŒä¸šåŠ¡åœºæ™¯çš„å®šåˆ¶

ç¼ºç‚¹ï¼š
âŒ æ ¼å¼ç›¸å¯¹å›ºå®šï¼Œå‡çº§éœ€è¦è€ƒè™‘å…¼å®¹æ€§
âŒ ä¿¡æ¯å¯èƒ½è¢«è§£æï¼Œéœ€è¦åŠ å¯†ä¿æŠ¤
```

## 2.2 Tokenç»“æ„è®¾è®¡å®ä¾‹



**ğŸ› ï¸ å¤šå±‚ç»“æ„è®¾è®¡**

```
Tokenå±‚æ¬¡ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å®Œæ•´Token                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Header    â”‚   Payload   â”‚  Signature  â”‚
â”‚   (å¤´éƒ¨)    â”‚   (è½½è·)    â”‚   (ç­¾å)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç±»å‹å’Œç‰ˆæœ¬   â”‚  ç”¨æˆ·ä¿¡æ¯    â”‚   å®‰å…¨æ ¡éªŒ   â”‚
â”‚ ç®—æ³•æ ‡è¯†     â”‚  æƒé™æ•°æ®    â”‚   é˜²ç¯¡æ”¹    â”‚
â”‚ è¿‡æœŸæ—¶é—´     â”‚  ä¸šåŠ¡æ•°æ®    â”‚   å®Œæ•´æ€§    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’» å®é™…ä»£ç å®ç°**

```java
public class CustomToken {
    
    // Tokenå¤´éƒ¨ä¿¡æ¯
    public static class Header {
        private String type = "CUSTOM";     // Tokenç±»å‹
        private String version = "1.0";     // ç‰ˆæœ¬å·
        private String algorithm = "HS256"; // åŠ å¯†ç®—æ³•
        private long expireTime;            // è¿‡æœŸæ—¶é—´
    }
    
    // Tokenè½½è·ä¿¡æ¯
    public static class Payload {
        private Long userId;                // ç”¨æˆ·ID
        private String username;            // ç”¨æˆ·å
        private List<String> roles;         // è§’è‰²åˆ—è¡¨
        private Map<String, Object> extra;  // æ‰©å±•ä¿¡æ¯
    }
    
    // ç”ŸæˆToken
    public String generateToken(Long userId, String username, List<String> roles) {
        Header header = new Header();
        header.expireTime = System.currentTimeMillis() + 24 * 60 * 60 * 1000; // 24å°æ—¶åè¿‡æœŸ
        
        Payload payload = new Payload();
        payload.userId = userId;
        payload.username = username;
        payload.roles = roles;
        
        // å°†headerå’Œpayloadè½¬ä¸ºJSONå¹¶Base64ç¼–ç 
        String headerEncoded = Base64.getEncoder().encodeToString(
            JSON.toJSONString(header).getBytes()
        );
        String payloadEncoded = Base64.getEncoder().encodeToString(
            JSON.toJSONString(payload).getBytes()
        );
        
        // ç”Ÿæˆç­¾å
        String signature = generateSignature(headerEncoded + "." + payloadEncoded);
        
        return headerEncoded + "." + payloadEncoded + "." + signature;
    }
}
```

---

# 3. ğŸ” åŠ å¯†Tokenå®ç°



## 3.1 ä¸ºä»€ä¹ˆéœ€è¦åŠ å¯†Tokenï¼Ÿ



**ğŸš¨ ä¸åŠ å¯†çš„é£é™©**

```
Tokenå†…å®¹æš´éœ²çš„åæœï¼š

ç”¨æˆ·ä¿¡æ¯æ³„éœ²ï¼š
æœªåŠ å¯†Token â”€â”€â–¶ Base64è§£ç  â”€â”€â–¶ ç”¨æˆ·IDã€è§’è‰²ç­‰ä¿¡æ¯æš´éœ²

ä¸šåŠ¡é€»è¾‘æš´éœ²ï¼š
Tokenç»“æ„ â”€â”€â–¶ ç³»ç»Ÿæ¶æ„ä¿¡æ¯ â”€â”€â–¶ ä¸ºæ”»å‡»è€…æä¾›çº¿ç´¢

ä¼ªé€ é£é™©ï¼š
äº†è§£æ ¼å¼ â”€â”€â–¶ å°è¯•æ„é€ Token â”€â”€â–¶ ç»•è¿‡è®¤è¯æœºåˆ¶
```

**ğŸ›¡ï¸ åŠ å¯†çš„ä¿æŠ¤ä½œç”¨**
- **ä¿¡æ¯ä¿æŠ¤**ï¼šå³ä½¿Tokenè¢«æˆªè·ï¼Œå†…å®¹ä¹Ÿæ— æ³•è¢«è§£è¯»
- **é˜²æ­¢ä¼ªé€ **ï¼šæ²¡æœ‰å¯†é’¥æ— æ³•ç”Ÿæˆæœ‰æ•ˆçš„åŠ å¯†Token
- **æé«˜å®‰å…¨æ€§**ï¼šå¢åŠ æ”»å‡»è€…çš„ç ´è§£æˆæœ¬

## 3.2 AESåŠ å¯†å®ç°



**ğŸ“š AESåŠ å¯†åŸºç¡€çŸ¥è¯†**

> ğŸ’¡ **AESç®€ä»‹**  
> AESï¼ˆAdvanced Encryption Standardï¼‰æ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå°±åƒä½ å’Œæœ‹å‹çº¦å®šä¸€ä¸ªæš—å·ï¼Œç”¨åŒä¸€ä¸ªå¯†é’¥æ¥åŠ å¯†å’Œè§£å¯†ä¿¡æ¯ã€‚

```java
import javax.crypto.Cipher;
import javax.crypto.KeyGenerator;
import javax.crypto.SecretKey;
import javax.crypto.spec.SecretKeySpec;
import java.util.Base64;

public class TokenEncryption {
    
    private static final String ALGORITHM = "AES";
    private static final String SECRET_KEY = "MySecretKey12345"; // 16å­—èŠ‚å¯†é’¥
    
    // åŠ å¯†Token
    public static String encryptToken(String originalToken) {
        try {
            SecretKeySpec secretKey = new SecretKeySpec(SECRET_KEY.getBytes(), ALGORITHM);
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            cipher.init(Cipher.ENCRYPT_MODE, secretKey);
            
            byte[] encrypted = cipher.doFinal(originalToken.getBytes());
            return Base64.getEncoder().encodeToString(encrypted);
        } catch (Exception e) {
            throw new RuntimeException("TokenåŠ å¯†å¤±è´¥", e);
        }
    }
    
    // è§£å¯†Token
    public static String decryptToken(String encryptedToken) {
        try {
            SecretKeySpec secretKey = new SecretKeySpec(SECRET_KEY.getBytes(), ALGORITHM);
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            cipher.init(Cipher.DECRYPT_MODE, secretKey);
            
            byte[] decoded = Base64.getDecoder().decode(encryptedToken);
            byte[] original = cipher.doFinal(decoded);
            return new String(original);
        } catch (Exception e) {
            throw new RuntimeException("Tokenè§£å¯†å¤±è´¥", e);
        }
    }
}
```

## 3.3 æ€§èƒ½è€ƒè™‘



**âš¡ åŠ å¯†æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**

```java
public class PerformanceOptimizedToken {
    
    // 1. å¯†é’¥å¤ç”¨ - é¿å…é‡å¤åˆ›å»ºå¯†é’¥å¯¹è±¡
    private static final SecretKeySpec SECRET_KEY_SPEC = 
        new SecretKeySpec("MySecretKey12345".getBytes(), "AES");
    
    // 2. Cipherå¯¹è±¡æ± åŒ– - é¿å…é‡å¤åˆ›å»ºCipher
    private static final ThreadLocal<Cipher> ENCRYPT_CIPHER = ThreadLocal.withInitial(() -> {
        try {
            Cipher cipher = Cipher.getInstance("AES");
            cipher.init(Cipher.ENCRYPT_MODE, SECRET_KEY_SPEC);
            return cipher;
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    });
    
    // é«˜æ€§èƒ½åŠ å¯†
    public static String fastEncrypt(String token) {
        try {
            byte[] encrypted = ENCRYPT_CIPHER.get().doFinal(token.getBytes());
            return Base64.getEncoder().encodeToString(encrypted);
        } catch (Exception e) {
            throw new RuntimeException("åŠ å¯†å¤±è´¥", e);
        }
    }
}
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”æµ‹è¯•**

| åŠ å¯†æ–¹å¼ | **10ä¸‡æ¬¡åŠ å¯†è€—æ—¶** | **å†…å­˜å ç”¨** | **é€‚ç”¨åœºæ™¯** |
|---------|------------------|-------------|-------------|
| ğŸ”¸ **æ¯æ¬¡åˆ›å»º** | `~2000ms` | `é«˜` | `ä½é¢‘ä½¿ç”¨` |
| ğŸ”¸ **å¯¹è±¡å¤ç”¨** | `~800ms` | `ä¸­` | `ä¸­é¢‘ä½¿ç”¨` |
| ğŸ”¸ **çº¿ç¨‹æ± åŒ–** | `~300ms` | `ä½` | `é«˜é¢‘ä½¿ç”¨` |

---

# 4. âœï¸ ç­¾åTokenæœºåˆ¶



## 4.1 ç­¾åçš„ä½œç”¨åŸç†



**ğŸ¤” ä»€ä¹ˆæ˜¯Tokenç­¾åï¼Ÿ**

> ğŸŒ° **ç”Ÿæ´»ç±»æ¯”**  
> ç­¾åå°±åƒæ˜¯åœ¨é‡è¦æ–‡ä»¶ä¸Šç›–ç« ï¼Œç« æ˜¯å”¯ä¸€çš„ï¼Œåˆ«äººæ— æ³•ä¼ªé€ ã€‚æœ‰äº†è¿™ä¸ªç« ï¼Œå°±èƒ½è¯æ˜æ–‡ä»¶æ˜¯çœŸå®çš„ï¼Œæ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ã€‚

```
Tokenç­¾åæµç¨‹ï¼š

åŸå§‹Tokenæ•°æ®
      â†“
ä½¿ç”¨å¯†é’¥ + ç­¾åç®—æ³•
      â†“
ç”Ÿæˆç­¾åå­—ç¬¦ä¸²
      â†“
é™„åŠ åˆ°Tokenæœ«å°¾
      â†“
å®Œæ•´çš„ç­¾åToken

éªŒè¯æµç¨‹ï¼š
æ”¶åˆ°Token â†’ åˆ†ç¦»æ•°æ®å’Œç­¾å â†’ é‡æ–°è®¡ç®—ç­¾å â†’ å¯¹æ¯”éªŒè¯
```

## 4.2 HMAC-SHA256ç­¾åå®ç°



```java
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.security.MessageDigest;
import java.util.Base64;

public class TokenSigner {
    
    private static final String HMAC_SHA256 = "HmacSHA256";
    private static final String SECRET_KEY = "MySigningKey123";
    
    // ç”Ÿæˆç­¾å
    public static String generateSignature(String data) {
        try {
            SecretKeySpec secretKeySpec = new SecretKeySpec(
                SECRET_KEY.getBytes(), HMAC_SHA256
            );
            
            Mac mac = Mac.getInstance(HMAC_SHA256);
            mac.init(secretKeySpec);
            
            byte[] signatureBytes = mac.doFinal(data.getBytes());
            return Base64.getEncoder().encodeToString(signatureBytes);
        } catch (Exception e) {
            throw new RuntimeException("ç­¾åç”Ÿæˆå¤±è´¥", e);
        }
    }
    
    // éªŒè¯ç­¾å
    public static boolean verifySignature(String data, String signature) {
        String expectedSignature = generateSignature(data);
        return expectedSignature.equals(signature);
    }
    
    // åˆ›å»ºç­¾åToken
    public static String createSignedToken(String payload) {
        String signature = generateSignature(payload);
        return payload + "." + signature;
    }
    
    // éªŒè¯ç­¾åToken
    public static boolean verifySignedToken(String signedToken) {
        String[] parts = signedToken.split("\\.");
        if (parts.length != 2) {
            return false;
        }
        
        String payload = parts[0];
        String signature = parts[1];
        
        return verifySignature(payload, signature);
    }
}
```

## 4.3 é˜²ç¯¡æ”¹å®Œæ•´æ€§éªŒè¯



**ğŸ›¡ï¸ ç­¾åå¦‚ä½•é˜²æ­¢ç¯¡æ”¹**

```java
public class TamperProofToken {
    
    // æ¼”ç¤ºç¯¡æ”¹æ£€æµ‹
    public static void main(String[] args) {
        String originalData = "userId:12345,role:admin,exp:1691836800";
        
        // 1. åˆ›å»ºç­¾åToken
        String signedToken = TokenSigner.createSignedToken(originalData);
        System.out.println("åŸå§‹Token: " + signedToken);
        
        // 2. éªŒè¯åŸå§‹Tokenï¼ˆåº”è¯¥é€šè¿‡ï¼‰
        boolean isValid = TokenSigner.verifySignedToken(signedToken);
        System.out.println("åŸå§‹TokenéªŒè¯: " + isValid); // true
        
        // 3. å°è¯•ç¯¡æ”¹Token
        String tamperedToken = signedToken.replace("admin", "user");
        System.out.println("ç¯¡æ”¹åToken: " + tamperedToken);
        
        // 4. éªŒè¯ç¯¡æ”¹Tokenï¼ˆåº”è¯¥å¤±è´¥ï¼‰
        boolean isTamperedValid = TokenSigner.verifySignedToken(tamperedToken);
        System.out.println("ç¯¡æ”¹TokenéªŒè¯: " + isTamperedValid); // false
    }
}
```

**âœ… å®Œæ•´æ€§ä¿æŠ¤æœºåˆ¶**

```
ç¯¡æ”¹æ£€æµ‹åŸç†ï¼š

åŸå§‹æ•°æ®: "userId:12345,role:admin"
å¯†é’¥: "MySigningKey123"
ç­¾åç®—æ³•: HMAC-SHA256
è®¡ç®—ç­¾å: "ABC123DEF456"

å¦‚æœæ”»å‡»è€…ä¿®æ”¹æ•°æ®:
ä¿®æ”¹å: "userId:12345,role:superadmin"
ä½¿ç”¨ç›¸åŒå¯†é’¥å’Œç®—æ³•é‡æ–°è®¡ç®—: "XYZ789GHI012"

ç”±äºç­¾åä¸åŒ¹é…ï¼Œç³»ç»ŸçŸ¥é“æ•°æ®è¢«ç¯¡æ”¹äº†ï¼
```

---

# 5. ğŸ—ï¸ å¤åˆTokenæ¶æ„



## 5.1 ä»€ä¹ˆæ˜¯å¤åˆTokenï¼Ÿ



**ğŸ”¸ å•ä¸€Tokençš„å±€é™æ€§**

```
é—®é¢˜åœºæ™¯ï¼š
ç”¨æˆ·ç™»å½• â”€â”€â–¶ è·å¾—Token â”€â”€â–¶ è®¿é—®å„ç§èµ„æº
   â”‚
   â””â”€ é—®é¢˜ï¼šä¸€ä¸ªToken"åŒ…æ‰“å¤©ä¸‹"ï¼Œæƒé™æ§åˆ¶ç²—ç³™

é£é™©åˆ†æï¼š
ğŸš¨ Tokenæ³„éœ² â”€â”€â–¶ æ‰€æœ‰æƒé™æš´éœ² â”€â”€â–¶ å®‰å…¨é£é™©é«˜
ğŸš¨ æƒé™å˜æ›´ â”€â”€â–¶ éœ€è¦é‡æ–°ç™»å½• â”€â”€â–¶ ç”¨æˆ·ä½“éªŒå·®
ğŸš¨ åŠŸèƒ½åŒºåˆ† â”€â”€â–¶ æ— æ³•ç²¾ç»†æ§åˆ¶ â”€â”€â–¶ å®‰å…¨æ€§ä½
```

**âœ… å¤åˆTokenè§£å†³æ–¹æ¡ˆ**

```
å¤åˆTokenæ¶æ„ï¼š

ä¸»Token (Access Token)
â”œâ”€â”€ åŸºç¡€æƒé™Token
â”œâ”€â”€ åŠŸèƒ½æƒé™Token
â””â”€â”€ èµ„æºè®¿é—®Token

åˆ·æ–°Token (Refresh Token)
â”œâ”€â”€ ç”¨äºåˆ·æ–°ä¸»Token
â””â”€â”€ é•¿æœŸæœ‰æ•ˆï¼Œæƒé™å—é™

ä¸´æ—¶Token (Temporary Token)
â”œâ”€â”€ ç‰¹å®šæ“ä½œæˆæƒ
â””â”€â”€ çŸ­æœŸæœ‰æ•ˆï¼Œå•æ¬¡ä½¿ç”¨
```

## 5.2 å¤šé‡éªŒè¯å®ç°



```java
public class CompositeTokenManager {
    
    // ä¸åŒç±»å‹çš„Token
    public enum TokenType {
        ACCESS("access", 3600),      // è®¿é—®Tokenï¼Œ1å°æ—¶æœ‰æ•ˆ
        REFRESH("refresh", 604800),   // åˆ·æ–°Tokenï¼Œ7å¤©æœ‰æ•ˆ
        OPERATION("operation", 300);  // æ“ä½œTokenï¼Œ5åˆ†é’Ÿæœ‰æ•ˆ
        
        private final String type;
        private final int validSeconds;
        
        TokenType(String type, int validSeconds) {
            this.type = type;
            this.validSeconds = validSeconds;
        }
    }
    
    // ç”Ÿæˆå¤åˆTokenç»„
    public static class TokenGroup {
        private String accessToken;    // ä¸»è®¿é—®Token
        private String refreshToken;   // åˆ·æ–°Token
        private long expireTime;       // è¿‡æœŸæ—¶é—´
        
        // getterå’Œsetteræ–¹æ³•...
    }
    
    // åˆ›å»ºTokenç»„
    public static TokenGroup createTokenGroup(Long userId, List<String> permissions) {
        TokenGroup group = new TokenGroup();
        
        // 1. åˆ›å»ºè®¿é—®Token
        TokenPayload accessPayload = new TokenPayload();
        accessPayload.setUserId(userId);
        accessPayload.setType(TokenType.ACCESS.type);
        accessPayload.setPermissions(permissions);
        accessPayload.setExpireTime(System.currentTimeMillis() + TokenType.ACCESS.validSeconds * 1000);
        
        group.accessToken = createSignedToken(accessPayload);
        
        // 2. åˆ›å»ºåˆ·æ–°Tokenï¼ˆæƒé™å—é™ï¼‰
        TokenPayload refreshPayload = new TokenPayload();
        refreshPayload.setUserId(userId);
        refreshPayload.setType(TokenType.REFRESH.type);
        refreshPayload.setPermissions(Arrays.asList("refresh")); // åªæœ‰åˆ·æ–°æƒé™
        refreshPayload.setExpireTime(System.currentTimeMillis() + TokenType.REFRESH.validSeconds * 1000);
        
        group.refreshToken = createSignedToken(refreshPayload);
        group.expireTime = accessPayload.getExpireTime();
        
        return group;
    }
    
    // éªŒè¯Tokenç»„åˆ
    public static boolean validateTokenGroup(String accessToken, String operation) {
        try {
            TokenPayload payload = parseToken(accessToken);
            
            // 1. éªŒè¯Tokenç±»å‹
            if (!TokenType.ACCESS.type.equals(payload.getType())) {
                return false;
            }
            
            // 2. éªŒè¯æ˜¯å¦è¿‡æœŸ
            if (payload.getExpireTime() < System.currentTimeMillis()) {
                return false;
            }
            
            // 3. éªŒè¯æ“ä½œæƒé™
            return payload.getPermissions().contains(operation);
            
        } catch (Exception e) {
            return false;
        }
    }
}
```

## 5.3 åˆ†å±‚å®‰å…¨ç­–ç•¥



**ğŸ° å®‰å…¨å±‚æ¬¡è®¾è®¡**

```
åˆ†å±‚å®‰å…¨æ¶æ„ï¼š

ç¬¬1å±‚ï¼šåŸºç¡€è®¤è¯
â”œâ”€â”€ ç”¨æˆ·åå¯†ç éªŒè¯
â”œâ”€â”€ ç”ŸæˆåŸºç¡€è®¿é—®Token
â””â”€â”€ æƒé™ï¼šåŸºæœ¬ç³»ç»Ÿè®¿é—®

ç¬¬2å±‚ï¼šåŠŸèƒ½æƒé™
â”œâ”€â”€ åŸºäºè§’è‰²çš„æƒé™æ£€æŸ¥
â”œâ”€â”€ ç”ŸæˆåŠŸèƒ½æƒé™Token
â””â”€â”€ æƒé™ï¼šç‰¹å®šåŠŸèƒ½æ¨¡å—

ç¬¬3å±‚ï¼šæ•æ„Ÿæ“ä½œ
â”œâ”€â”€ é¢å¤–èº«ä»½éªŒè¯ï¼ˆçŸ­ä¿¡ã€é‚®ç®±ï¼‰
â”œâ”€â”€ ç”Ÿæˆä¸´æ—¶æ“ä½œToken
â””â”€â”€ æƒé™ï¼šæ•æ„Ÿæ•°æ®æ“ä½œ

ç¬¬4å±‚ï¼šè¶…çº§æƒé™
â”œâ”€â”€ ç®¡ç†å‘˜äºŒæ¬¡è®¤è¯
â”œâ”€â”€ ç”Ÿæˆè¶…çº§ç®¡ç†Token
â””â”€â”€ æƒé™ï¼šç³»ç»Ÿç®¡ç†åŠŸèƒ½
```

**ğŸ’¼ å®é™…åº”ç”¨ç¤ºä¾‹**

```java
// é“¶è¡Œç³»ç»Ÿçš„å¤åˆTokenç¤ºä¾‹
public class BankingTokenSystem {
    
    public void demonstrateCompositeTokens() {
        // ç”¨æˆ·ç™»å½• - è·å¾—åŸºç¡€Token
        TokenGroup basicTokens = createBasicLoginTokens(userId);
        System.out.println("âœ… ç™»å½•æˆåŠŸï¼Œå¯ä»¥æŸ¥çœ‹è´¦æˆ·ä½™é¢");
        
        // è½¬è´¦æ“ä½œ - éœ€è¦é¢å¤–éªŒè¯
        if (requiresTransferToken()) {
            String transferToken = createOperationToken(userId, "transfer", smsCode);
            System.out.println("âœ… çŸ­ä¿¡éªŒè¯é€šè¿‡ï¼Œå¯ä»¥æ‰§è¡Œè½¬è´¦");
        }
        
        // ä¿®æ”¹å¯†ç  - éœ€è¦æœ€é«˜çº§éªŒè¯
        if (requiresSecurityToken()) {
            String securityToken = createSecurityToken(userId, emailCode, idCard);
            System.out.println("âœ… å¤šé‡éªŒè¯é€šè¿‡ï¼Œå¯ä»¥ä¿®æ”¹å¯†ç ");
        }
    }
    
    private boolean requiresTransferToken() {
        // å‘é€çŸ­ä¿¡éªŒè¯ç 
        // éªŒè¯çŸ­ä¿¡éªŒè¯ç 
        // ç”Ÿæˆè½¬è´¦ä¸“ç”¨Token
        return true;
    }
}
```

---

# 6. ğŸŠ Tokenæ± åŒ–ä¼˜åŒ–



## 6.1 ä»€ä¹ˆæ˜¯Tokenæ± åŒ–ï¼Ÿ



**ğŸ¤” Tokenæ± åŒ–çš„æ¦‚å¿µ**

> ğŸŒ° **æ¸¸æ³³æ± ç±»æ¯”**  
> Tokenæ± å°±åƒæ¸¸æ³³æ± ï¼Œæå‰å‡†å¤‡å¥½ä¸€æ± å­æ°´ï¼ˆé¢„ç”ŸæˆTokenï¼‰ï¼Œå®¢äººæ¥äº†ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨ç°åœºçƒ§æ°´ã€‚ç”¨å®Œåæ¸…æ´ä¸€ä¸‹æ”¾å›æ± å­ï¼Œä¸‹ä¸ªå®¢äººç»§ç»­ä½¿ç”¨ã€‚

```
ä¼ ç»Ÿæ–¹å¼ vs æ± åŒ–æ–¹å¼ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼š
ç”¨æˆ·è¯·æ±‚ â”€â”€â–¶ ç°åœºç”ŸæˆToken â”€â”€â–¶ è¿”å›ç»™ç”¨æˆ·
é—®é¢˜ï¼šæ¯æ¬¡éƒ½è¦è®¡ç®—ï¼ŒCPUæ¶ˆè€—å¤§ï¼Œå“åº”æ…¢

æ± åŒ–æ–¹å¼ï¼š
ç³»ç»Ÿå¯åŠ¨ â”€â”€â–¶ é¢„ç”ŸæˆTokenæ±  â”€â”€â–¶ ç”¨æˆ·è¯·æ±‚æ—¶ç›´æ¥åˆ†é…
ä¼˜åŠ¿ï¼šå“åº”å¿«ï¼ŒCPUæ¶ˆè€—å°ï¼Œæå‡å¹¶å‘èƒ½åŠ›
```

## 6.2 Tokenæ± åŒ–å®ç°



```java
import java.util.concurrent.ArrayBlockingQueue;
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

public class TokenPool {
    
    private final BlockingQueue<String> tokenPool;
    private final ScheduledExecutorService scheduler;
    private final int maxPoolSize;
    private final int minPoolSize;
    
    public TokenPool(int maxSize, int minSize) {
        this.maxPoolSize = maxSize;
        this.minPoolSize = minSize;
        this.tokenPool = new ArrayBlockingQueue<>(maxSize);
        this.scheduler = Executors.newScheduledThreadPool(2);
        
        // å¯åŠ¨æ—¶é¢„ç”ŸæˆToken
        initializePool();
        // å®šæœŸæ£€æŸ¥å’Œè¡¥å……Token
        startPoolMaintenance();
    }
    
    // åˆå§‹åŒ–Tokenæ± 
    private void initializePool() {
        for (int i = 0; i < minPoolSize; i++) {
            String preGeneratedToken = generateBaseToken();
            tokenPool.offer(preGeneratedToken);
        }
        System.out.println("Tokenæ± åˆå§‹åŒ–å®Œæˆï¼Œé¢„ç”ŸæˆTokenæ•°é‡ï¼š" + minPoolSize);
    }
    
    // ä»æ± ä¸­è·å–Token
    public String getToken(Long userId, List<String> permissions) {
        try {
            // 1. ä»æ± ä¸­è·å–åŸºç¡€Tokenï¼ˆéé˜»å¡ï¼‰
            String baseToken = tokenPool.poll();
            
            if (baseToken == null) {
                // æ± å­ç©ºäº†ï¼Œç›´æ¥ç”Ÿæˆæ–°Token
                return generateCustomToken(userId, permissions);
            }
            
            // 2. å°†ç”¨æˆ·ä¿¡æ¯æ³¨å…¥åˆ°åŸºç¡€Tokenä¸­
            return customizeToken(baseToken, userId, permissions);
            
        } catch (Exception e) {
            // å‡ºé”™æ—¶é™çº§å¤„ç†
            return generateCustomToken(userId, permissions);
        }
    }
    
    // å½’è¿˜Tokenåˆ°æ± ä¸­ï¼ˆç”¨äºå¯é‡ç”¨çš„Tokenï¼‰
    public void returnToken(String token) {
        // æ¸…ç†ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œé‡ç½®ä¸ºåŸºç¡€Token
        String cleanedToken = cleanTokenForReuse(token);
        
        if (tokenPool.size() < maxPoolSize) {
            tokenPool.offer(cleanedToken);
        }
    }
    
    // å®šæœŸç»´æŠ¤Tokenæ± 
    private void startPoolMaintenance() {
        // æ¯éš”30ç§’æ£€æŸ¥ä¸€æ¬¡æ± çŠ¶æ€
        scheduler.scheduleAtFixedRate(() -> {
            int currentSize = tokenPool.size();
            
            // å¦‚æœæ± ä¸­Tokenæ•°é‡è¿‡å°‘ï¼Œè¡¥å……Token
            if (currentSize < minPoolSize) {
                int needToAdd = minPoolSize - currentSize;
                for (int i = 0; i < needToAdd; i++) {
                    String newToken = generateBaseToken();
                    tokenPool.offer(newToken);
                }
                System.out.println("è¡¥å……Tokenæ± ï¼Œæ–°å¢æ•°é‡ï¼š" + needToAdd);
            }
        }, 30, 30, TimeUnit.SECONDS);
    }
    
    // ç”ŸæˆåŸºç¡€Tokenï¼ˆæ— ç”¨æˆ·ä¿¡æ¯ï¼‰
    private String generateBaseToken() {
        return "BASE_" + System.currentTimeMillis() + "_" + 
               UUID.randomUUID().toString().replace("-", "").substring(0, 8);
    }
    
    // å®šåˆ¶Tokenï¼ˆæ³¨å…¥ç”¨æˆ·ä¿¡æ¯ï¼‰
    private String customizeToken(String baseToken, Long userId, List<String> permissions) {
        // å°†ç”¨æˆ·ä¿¡æ¯ç¼–ç å¹¶é™„åŠ åˆ°åŸºç¡€Token
        String userInfo = userId + ":" + String.join(",", permissions);
        String encodedUserInfo = Base64.getEncoder().encodeToString(userInfo.getBytes());
        return baseToken + "." + encodedUserInfo;
    }
}
```

## 6.3 æ€§èƒ½ä¼˜åŒ–æ•ˆæœ



**ğŸ“Š æ€§èƒ½å¯¹æ¯”æ•°æ®**

```java
public class TokenPerformanceTest {
    
    public void performanceComparison() {
        int testCount = 100000;
        
        // æµ‹è¯•ä¼ ç»Ÿæ–¹å¼
        long start1 = System.currentTimeMillis();
        for (int i = 0; i < testCount; i++) {
            generateTokenTraditional(12345L, Arrays.asList("read", "write"));
        }
        long time1 = System.currentTimeMillis() - start1;
        
        // æµ‹è¯•æ± åŒ–æ–¹å¼
        TokenPool pool = new TokenPool(1000, 100);
        long start2 = System.currentTimeMillis();
        for (int i = 0; i < testCount; i++) {
            pool.getToken(12345L, Arrays.asList("read", "write"));
        }
        long time2 = System.currentTimeMillis() - start2;
        
        System.out.println("ä¼ ç»Ÿæ–¹å¼è€—æ—¶ï¼š" + time1 + "ms");
        System.out.println("æ± åŒ–æ–¹å¼è€—æ—¶ï¼š" + time2 + "ms");
        System.out.println("æ€§èƒ½æå‡ï¼š" + ((double)(time1 - time2) / time1 * 100) + "%");
    }
}
```

| æµ‹è¯•åœºæ™¯ | **ä¼ ç»Ÿæ–¹å¼** | **æ± åŒ–æ–¹å¼** | **æ€§èƒ½æå‡** |
|---------|-------------|-------------|-------------|
| ğŸ”¸ **10ä¸‡æ¬¡ç”Ÿæˆ** | `~1200ms` | `~300ms` | `75%` |
| ğŸ”¸ **å¹¶å‘1000** | `~5000ms` | `~800ms` | `84%` |
| ğŸ”¸ **å†…å­˜ä½¿ç”¨** | `åŠ¨æ€å¢é•¿` | `å›ºå®šå¤§å°` | `å†…å­˜å¯æ§` |

---

# 7. ğŸ›¡ï¸ å®‰å…¨å¢å¼ºç­–ç•¥



## 7.1 æŒ‡çº¹ç»‘å®šæŠ€æœ¯



**ğŸ”¸ ä»€ä¹ˆæ˜¯TokenæŒ‡çº¹ç»‘å®šï¼Ÿ**

> ğŸ’¡ **æŒ‡çº¹ç†è§£**  
> å°±åƒæ¯ä¸ªäººçš„æŒ‡çº¹éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªTokenç”Ÿæˆä¸€ä¸ª"æŒ‡çº¹"ï¼Œè¿™ä¸ªæŒ‡çº¹åŒ…å«äº†å®¢æˆ·ç«¯çš„ç‰¹å¾ä¿¡æ¯ï¼ŒTokenåªèƒ½åœ¨ç‰¹å®šç¯å¢ƒä¸‹ä½¿ç”¨ã€‚

```java
public class TokenFingerprint {
    
    // ç”Ÿæˆå®¢æˆ·ç«¯æŒ‡çº¹
    public static String generateFingerprint(HttpServletRequest request) {
        StringBuilder fingerprint = new StringBuilder();
        
        // 1. ç”¨æˆ·ä»£ç†ä¿¡æ¯
        String userAgent = request.getHeader("User-Agent");
        if (userAgent != null) {
            fingerprint.append(userAgent.hashCode());
        }
        
        // 2. å®¢æˆ·ç«¯IPåœ°å€
        String clientIP = getClientIP(request);
        fingerprint.append(":").append(clientIP);
        
        // 3. Accept-Languageå¤´ä¿¡æ¯
        String acceptLanguage = request.getHeader("Accept-Language");
        if (acceptLanguage != null) {
            fingerprint.append(":").append(acceptLanguage.hashCode());
        }
        
        // 4. å±å¹•åˆ†è¾¨ç‡ï¼ˆé€šè¿‡è‡ªå®šä¹‰å¤´éƒ¨ä¼ é€’ï¼‰
        String screenResolution = request.getHeader("X-Screen-Resolution");
        if (screenResolution != null) {
            fingerprint.append(":").append(screenResolution);
        }
        
        // ç”Ÿæˆæœ€ç»ˆæŒ‡çº¹å“ˆå¸Œ
        return DigestUtils.md5Hex(fingerprint.toString());
    }
    
    // å°†æŒ‡çº¹ç»‘å®šåˆ°Token
    public static String bindFingerprintToToken(String originalToken, String fingerprint) {
        return originalToken + "." + fingerprint;
    }
    
    // éªŒè¯TokenæŒ‡çº¹
    public static boolean verifyTokenFingerprint(String tokenWithFingerprint, 
                                                HttpServletRequest request) {
        String[] parts = tokenWithFingerprint.split("\\.");
        if (parts.length < 2) {
            return false;
        }
        
        String tokenFingerprint = parts[parts.length - 1]; // æœ€åä¸€éƒ¨åˆ†æ˜¯æŒ‡çº¹
        String currentFingerprint = generateFingerprint(request);
        
        return tokenFingerprint.equals(currentFingerprint);
    }
}
```

## 7.2 è®¾å¤‡ç»‘å®šæœºåˆ¶



**ğŸ”¸ è®¾å¤‡ç»‘å®šçš„å·¥ä½œåŸç†**

```
è®¾å¤‡ç»‘å®šæµç¨‹ï¼š

ç”¨æˆ·é¦–æ¬¡ç™»å½•
      â†“
æ”¶é›†è®¾å¤‡ä¿¡æ¯ï¼ˆè®¾å¤‡IDã€æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ç­‰ï¼‰
      â†“
ç”Ÿæˆè®¾å¤‡å”¯ä¸€æ ‡è¯†
      â†“
å°†è®¾å¤‡æ ‡è¯†å†™å…¥Token
      â†“
åç»­è¯·æ±‚éªŒè¯è®¾å¤‡æ ‡è¯†

è®¾å¤‡ä¿¡æ¯æ”¶é›†ï¼š
ğŸ“± ç§»åŠ¨è®¾å¤‡ï¼šè®¾å¤‡UUIDã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€åº”ç”¨ç‰ˆæœ¬
ğŸ’» PCè®¾å¤‡ï¼šç¡¬ä»¶æŒ‡çº¹ã€æµè§ˆå™¨ç‰ˆæœ¬ã€æ’ä»¶ä¿¡æ¯
ğŸŒ Webåº”ç”¨ï¼šæµè§ˆå™¨æŒ‡çº¹ã€CanvasæŒ‡çº¹ã€WebGLæŒ‡çº¹
```

```java
public class DeviceBinding {
    
    // è®¾å¤‡ä¿¡æ¯æ”¶é›†
    public static class DeviceInfo {
        private String deviceId;        // è®¾å¤‡å”¯ä¸€ID
        private String operatingSystem; // æ“ä½œç³»ç»Ÿ
        private String browserInfo;     // æµè§ˆå™¨ä¿¡æ¯
        private String hardwareInfo;    // ç¡¬ä»¶ä¿¡æ¯
        
        // ç”Ÿæˆè®¾å¤‡æŒ‡çº¹
        public String generateDeviceFingerprint() {
            String combined = deviceId + ":" + operatingSystem + ":" + 
                            browserInfo + ":" + hardwareInfo;
            return DigestUtils.sha256Hex(combined);
        }
    }
    
    // ç»‘å®šè®¾å¤‡åˆ°Token
    public static String bindDeviceToToken(String token, DeviceInfo deviceInfo) {
        String deviceFingerprint = deviceInfo.generateDeviceFingerprint();
        
        // å°†è®¾å¤‡æŒ‡çº¹åŠ å¯†åæ·»åŠ åˆ°Token
        String encryptedFingerprint = TokenEncryption.encryptToken(deviceFingerprint);
        return token + ".DEV." + encryptedFingerprint;
    }
    
    // éªŒè¯è®¾å¤‡ç»‘å®š
    public static boolean verifyDeviceBinding(String tokenWithDevice, DeviceInfo currentDevice) {
        try {
            String[] parts = tokenWithDevice.split("\\.DEV\\.");
            if (parts.length != 2) {
                return false;
            }
            
            String encryptedFingerprint = parts[1];
            String decryptedFingerprint = TokenEncryption.decryptToken(encryptedFingerprint);
            String currentFingerprint = currentDevice.generateDeviceFingerprint();
            
            return decryptedFingerprint.equals(currentFingerprint);
        } catch (Exception e) {
            return false;
        }
    }
    
    // è®¾å¤‡å˜æ›´æ£€æµ‹
    public static boolean isDeviceChanged(String oldToken, DeviceInfo newDevice) {
        return !verifyDeviceBinding(oldToken, newDevice);
    }
}
```

## 7.3 å¤šé‡å®‰å…¨éªŒè¯



**ğŸ° å¤šå±‚å®‰å…¨é˜²æŠ¤ä½“ç³»**

```java
public class MultiLayerSecurity {
    
    // ç»¼åˆå®‰å…¨éªŒè¯
    public static class SecurityValidationResult {
        private boolean isValid;
        private String errorMessage;
        private SecurityLevel securityLevel;
        
        public enum SecurityLevel {
            LOW, MEDIUM, HIGH, CRITICAL
        }
    }
    
    // æ‰§è¡Œå¤šé‡å®‰å…¨éªŒè¯
    public static SecurityValidationResult validateToken(String token, 
                                                        HttpServletRequest request,
                                                        DeviceInfo deviceInfo) {
        SecurityValidationResult result = new SecurityValidationResult();
        
        try {
            // ç¬¬1å±‚ï¼šåŸºç¡€Tokenæ ¼å¼éªŒè¯
            if (!isValidTokenFormat(token)) {
                result.isValid = false;
                result.errorMessage = "Tokenæ ¼å¼æ— æ•ˆ";
                return result;
            }
            
            // ç¬¬2å±‚ï¼šç­¾åéªŒè¯ï¼ˆé˜²ç¯¡æ”¹ï¼‰
            if (!TokenSigner.verifySignedToken(token)) {
                result.isValid = false;
                result.errorMessage = "Tokenç­¾åéªŒè¯å¤±è´¥";
                return result;
            }
            
            // ç¬¬3å±‚ï¼šè¿‡æœŸæ—¶é—´éªŒè¯
            if (isTokenExpired(token)) {
                result.isValid = false;
                result.errorMessage = "Tokenå·²è¿‡æœŸ";
                return result;
            }
            
            // ç¬¬4å±‚ï¼šæŒ‡çº¹ç»‘å®šéªŒè¯
            if (!TokenFingerprint.verifyTokenFingerprint(token, request)) {
                result.isValid = false;
                result.errorMessage = "å®¢æˆ·ç«¯æŒ‡çº¹éªŒè¯å¤±è´¥";
                result.securityLevel = SecurityValidationResult.SecurityLevel.MEDIUM;
                return result;
            }
            
            // ç¬¬5å±‚ï¼šè®¾å¤‡ç»‘å®šéªŒè¯
            if (!DeviceBinding.verifyDeviceBinding(token, deviceInfo)) {
                result.isValid = false;
                result.errorMessage = "è®¾å¤‡ç»‘å®šéªŒè¯å¤±è´¥";
                result.securityLevel = SecurityValidationResult.SecurityLevel.HIGH;
                return result;
            }
            
            // ç¬¬6å±‚ï¼šé¢‘ç‡é™åˆ¶æ£€æŸ¥
            if (isRateLimited(extractUserId(token))) {
                result.isValid = false;
                result.errorMessage = "è®¿é—®é¢‘ç‡è¶…å‡ºé™åˆ¶";
                result.securityLevel = SecurityValidationResult.SecurityLevel.CRITICAL;
                return result;
            }
            
            // æ‰€æœ‰éªŒè¯é€šè¿‡
            result.isValid = true;
            result.securityLevel = SecurityValidationResult.SecurityLevel.LOW;
            return result;
            
        } catch (Exception e) {
            result.isValid = false;
            result.errorMessage = "éªŒè¯è¿‡ç¨‹å¼‚å¸¸ï¼š" + e.getMessage();
            return result;
        }
    }
}
```

**ğŸš¨ å®‰å…¨äº‹ä»¶å¤„ç†**

```java
public class SecurityEventHandler {
    
    // å®‰å…¨äº‹ä»¶ç±»å‹
    public enum SecurityEvent {
        INVALID_TOKEN("æ— æ•ˆTokenå°è¯•"),
        FINGERPRINT_MISMATCH("æŒ‡çº¹ä¸åŒ¹é…"),
        DEVICE_CHANGED("è®¾å¤‡å˜æ›´"),
        RATE_LIMIT_EXCEEDED("é¢‘ç‡é™åˆ¶è¶…å‡º"),
        SUSPICIOUS_ACTIVITY("å¯ç–‘æ´»åŠ¨");
        
        private final String description;
        
        SecurityEvent(String description) {
            this.description = description;
        }
    }
    
    // å¤„ç†å®‰å…¨äº‹ä»¶
    public static void handleSecurityEvent(SecurityEvent event, String userId, 
                                         String clientIP, Map<String, Object> details) {
        // 1. è®°å½•å®‰å…¨æ—¥å¿—
        logSecurityEvent(event, userId, clientIP, details);
        
        // 2. æ ¹æ®äº‹ä»¶ç±»å‹é‡‡å–ç›¸åº”æªæ–½
        switch (event) {
            case FINGERPRINT_MISMATCH:
            case DEVICE_CHANGED:
                // è¦æ±‚ç”¨æˆ·é‡æ–°è®¤è¯
                requireReAuthentication(userId);
                break;
                
            case RATE_LIMIT_EXCEEDED:
                // ä¸´æ—¶å°ç¦IP
                blockClientIP(clientIP, 15); // å°ç¦15åˆ†é’Ÿ
                break;
                
            case SUSPICIOUS_ACTIVITY:
                // å†»ç»“è´¦æˆ·ï¼Œå‘é€å®‰å…¨é€šçŸ¥
                freezeAccount(userId);
                sendSecurityAlert(userId);
                break;
        }
    }
}
```

---

# 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## 8.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ



**ğŸ”¸ Tokenè®¾è®¡åŸºç¡€**
- **Tokenæœ¬è´¨**ï¼šèº«ä»½å‡­è¯ï¼Œåƒä¸´æ—¶é€šè¡Œè¯
- **ç»“æ„åŒ–è®¾è®¡**ï¼šåŒ…å«ä¿¡æ¯ï¼Œå‡å°‘æŸ¥åº“æ¬¡æ•°
- **éç»“æ„åŒ–è®¾è®¡**ï¼šçº¯éšæœºï¼Œå®‰å…¨ä½†éœ€è¦å­˜å‚¨éªŒè¯ä¿¡æ¯

**ğŸ”¸ å®‰å…¨æœºåˆ¶ç†è§£**
- **åŠ å¯†ä¿æŠ¤**ï¼šé˜²æ­¢Tokenå†…å®¹è¢«è§£è¯»
- **ç­¾åéªŒè¯**ï¼šé˜²æ­¢Tokenè¢«ç¯¡æ”¹
- **æŒ‡çº¹ç»‘å®š**ï¼šé˜²æ­¢Tokenè¢«ç›—ç”¨

## 8.2 å®é™…åº”ç”¨è¦ç‚¹



**ğŸ”¹ é€‰æ‹©åˆé€‚çš„Tokenç±»å‹**

| åœºæ™¯ | **æ¨èæ–¹æ¡ˆ** | **ä¸»è¦è€ƒè™‘** |
|------|-------------|-------------|
| ğŸ”¸ **é«˜å®‰å…¨åœºæ™¯** | `åŠ å¯†+ç­¾å+ç»‘å®š` | `é“¶è¡Œã€æ”¯ä»˜ç³»ç»Ÿ` |
| ğŸ”¸ **é«˜æ€§èƒ½åœºæ™¯** | `ç»“æ„åŒ–+æ± åŒ–` | `é«˜å¹¶å‘Webåº”ç”¨` |
| ğŸ”¸ **ç®€å•åº”ç”¨** | `JWTæˆ–ç®€å•ç­¾å` | `å†…éƒ¨ç³»ç»Ÿã€åŸå‹` |

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
```
ä½é¢‘åº”ç”¨ï¼šæŒ‰éœ€ç”Ÿæˆï¼Œæ³¨é‡å®‰å…¨æ€§
ä¸­é¢‘åº”ç”¨ï¼šé€‚åº¦ç¼“å­˜ï¼Œå¹³è¡¡å®‰å…¨æ€§èƒ½
é«˜é¢‘åº”ç”¨ï¼šæ± åŒ–é¢„ç”Ÿæˆï¼Œé‡ç‚¹ä¼˜åŒ–æ€§èƒ½
```

**ğŸ”¹ å®‰å…¨é˜²æŠ¤å±‚æ¬¡**
```
åŸºç¡€é˜²æŠ¤ï¼šæ ¼å¼éªŒè¯ + ç­¾åéªŒè¯ + è¿‡æœŸæ£€æŸ¥
ä¸­çº§é˜²æŠ¤ï¼š+ æŒ‡çº¹ç»‘å®š + è®¾å¤‡ç»‘å®š
é«˜çº§é˜²æŠ¤ï¼š+ å¤šé‡éªŒè¯ + è¡Œä¸ºåˆ†æ + é£é™©æ§åˆ¶
```

## 8.3 æœ€ä½³å®è·µå»ºè®®



**ğŸ’¡ è®¾è®¡åŸåˆ™**
- **å®‰å…¨ç¬¬ä¸€**ï¼šå®å¯å¤æ‚ä¸€äº›ï¼Œä¹Ÿè¦ä¿è¯å®‰å…¨
- **æ€§èƒ½å…¼é¡¾**ï¼šåœ¨ä¿è¯å®‰å…¨çš„å‰æä¸‹ä¼˜åŒ–æ€§èƒ½
- **æ˜“äºç»´æŠ¤**ï¼šä»£ç æ¸…æ™°ï¼Œé€»è¾‘ç®€å•ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
- **æ¸è¿›å¢å¼º**ï¼šä»ç®€å•å¼€å§‹ï¼Œé€æ­¥å¢åŠ å®‰å…¨åŠŸèƒ½

**âš ï¸ å¸¸è§é™·é˜±**
- âŒ ä¸è¦åœ¨Tokenä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€é“¶è¡Œå¡å·ç­‰ï¼‰
- âŒ ä¸è¦ä½¿ç”¨è¿‡äºå¤æ‚çš„åŠ å¯†ç®—æ³•å½±å“æ€§èƒ½
- âŒ ä¸è¦å¿½è§†Tokençš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âŒ ä¸è¦åœ¨å®¢æˆ·ç«¯å­˜å‚¨æ°¸ä¹…Token

**ğŸ¯ è®°å¿†è¦ç‚¹**
- **Tokenè®¾è®¡å¦‚æ­ç§¯æœ¨**ï¼šå…ˆæ­åŸºç¡€æ¡†æ¶ï¼Œå†æ·»åŠ å®‰å…¨åŠŸèƒ½
- **å®‰å…¨å¦‚å»ºåŸå¢™**ï¼šä¸€å±‚å±‚åŠ å›ºï¼Œå¤šé‡é˜²æŠ¤
- **æ€§èƒ½å¦‚ä¿®æ°´æ¸ **ï¼šæå‰è§„åˆ’ï¼Œæ± åŒ–å¤ç”¨
- **ç»´æŠ¤å¦‚å…»èŠ±è‰**ï¼šå®šæœŸæ£€æŸ¥ï¼ŒåŠæ—¶æ›´æ–°