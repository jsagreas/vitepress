---
title: 5ã€Tokenè®¤è¯æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [Tokenè®¤è¯æœºåˆ¶æ¦‚è¿°](#1-tokenè®¤è¯æœºåˆ¶æ¦‚è¿°)
2. [ä»¤ç‰Œç”Ÿæˆç­–ç•¥](#2-ä»¤ç‰Œç”Ÿæˆç­–ç•¥)
3. [Tokenå­˜å‚¨ä¸ä¼ è¾“](#3-tokenå­˜å‚¨ä¸ä¼ è¾“)
4. [æœ‰æ•ˆæœŸè®¾ç½®ç­–ç•¥](#4-æœ‰æ•ˆæœŸè®¾ç½®ç­–ç•¥)
5. [Tokenæ’¤é”€ä¸é»‘åå•æœºåˆ¶](#5-tokenæ’¤é”€ä¸é»‘åå•æœºåˆ¶)
6. [è‡ªå®šä¹‰Tokenè®¤è¯ç³»ç»Ÿå®æˆ˜](#6-è‡ªå®šä¹‰tokenè®¤è¯ç³»ç»Ÿå®æˆ˜)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Tokenè®¤è¯æœºåˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Tokenè®¤è¯


**Tokenè®¤è¯**å°±åƒæ˜¯ä¸€å¼ **æ•°å­—èº«ä»½è¯**ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨ç»™ç”¨æˆ·é¢å‘ä¸€ä¸ªç‰¹æ®Šçš„"é€šè¡Œè¯"ï¼Œç”¨æˆ·æ‹¿ç€è¿™ä¸ªé€šè¡Œè¯å°±å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šTokenå°±åƒç”µå½±ç¥¨ï¼Œä½ ä¹°ç¥¨åæ‹¿ç€ç¥¨æ ¹å°±èƒ½è¿›ç”µå½±é™¢çœ‹ç”µå½±ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°ä¹°ç¥¨éªŒè¯èº«ä»½ã€‚

```
ä¼ ç»Ÿè®¤è¯æµç¨‹ï¼š                    Tokenè®¤è¯æµç¨‹ï¼š
ç”¨æˆ· â†’ æ¯æ¬¡éƒ½è¦è¾“å…¥è´¦å·å¯†ç           ç”¨æˆ· â†’ ç™»å½•ä¸€æ¬¡è·å–Token
      â†“                                â†“
æœåŠ¡å™¨éªŒè¯è´¦å·å¯†ç                    æœåŠ¡å™¨éªŒè¯Tokenå³å¯
```

### 1.2 Tokenè®¤è¯çš„æ ¸å¿ƒä¼˜åŠ¿


```
ğŸ¯ æ— çŠ¶æ€æ€§ï¼š
- æœåŠ¡å™¨ä¸éœ€è¦ä¿å­˜ç”¨æˆ·ç™»å½•çŠ¶æ€
- æ¯ä¸ªTokenåŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
- ä¾¿äºåˆ†å¸ƒå¼ç³»ç»Ÿæ‰©å±•

ğŸ”„ è·¨åŸŸå‹å¥½ï¼š
- ä¸ä¾èµ–Cookieï¼Œè§£å†³è·¨åŸŸé—®é¢˜
- é€‚åˆç§»åŠ¨ç«¯APPå’Œå‰åç«¯åˆ†ç¦»

âš¡ æ€§èƒ½ä¼˜è‰¯ï¼š
- å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°
- æœåŠ¡å™¨å†…å­˜å‹åŠ›å°
```

### 1.3 Tokenè®¤è¯å·¥ä½œåŸç†


```
å®¢æˆ·ç«¯                    æœåŠ¡å™¨                   æ•°æ®åº“
  |                        |                        |
  |--[1]ç™»å½•è¯·æ±‚----------->|                        |
  |   {ç”¨æˆ·å, å¯†ç }        |--[2]éªŒè¯ç”¨æˆ·ä¿¡æ¯------->|
  |                        |<-[3]è¿”å›ç”¨æˆ·ä¿¡æ¯-------|
  |<-[4]è¿”å›Token----------|                        |
  |   {token: "abc123"}    |                        |
  |                        |                        |
  |--[5]ä¸šåŠ¡è¯·æ±‚----------->|                        |
  |   Header: Token        |--[6]éªŒè¯Token--------->|
  |                        |<-[7]éªŒè¯ç»“æœ-----------|
  |<-[8]è¿”å›ä¸šåŠ¡æ•°æ®-------|                        |
```

---

## 2. ğŸ² ä»¤ç‰Œç”Ÿæˆç­–ç•¥


### 2.1 Tokenç”Ÿæˆçš„åŸºæœ¬åŸåˆ™


> ğŸ”’ **å®‰å…¨ç¬¬ä¸€**ï¼šTokenå¿…é¡»**ä¸å¯é¢„æµ‹**ã€**ä¸å¯ä¼ªé€ **ã€**å”¯ä¸€æ€§**

**æ ¸å¿ƒè¦ç´ **ï¼š
- **éšæœºæ€§**ï¼šä½¿ç”¨åŠ å¯†çº§åˆ«çš„éšæœºæ•°ç”Ÿæˆå™¨
- **å”¯ä¸€æ€§**ï¼šç¡®ä¿åŒä¸€æ—¶é—´ä¸ä¼šäº§ç”Ÿç›¸åŒToken
- **ä¸å¯é€†**ï¼šä»Tokenæ— æ³•åæ¨å‡ºç”¨æˆ·æ•æ„Ÿä¿¡æ¯

### 2.2 å¸¸è§Tokenç”Ÿæˆç®—æ³•


#### ğŸ¯ UUID + æ—¶é—´æˆ³æ–¹æ¡ˆ


```java
public class TokenGenerator {
    
    /**
     * ç”ŸæˆåŸºäºUUIDçš„Token
     * ä¼˜ç‚¹ï¼šç®€å•ã€å”¯ä¸€æ€§å¥½
     * ç¼ºç‚¹ï¼šé•¿åº¦è¾ƒé•¿ã€æ— æ³•æºå¸¦ç”¨æˆ·ä¿¡æ¯
     */
    public static String generateUUIDToken(Long userId) {
        String uuid = UUID.randomUUID().toString().replace("-", "");
        String timestamp = String.valueOf(System.currentTimeMillis());
        
        // ç»„åˆï¼šUUID + ç”¨æˆ·ID + æ—¶é—´æˆ³
        String rawToken = uuid + userId + timestamp;
        
        // è¿›è¡ŒSHA-256å“ˆå¸Œï¼Œå¢åŠ å®‰å…¨æ€§
        return DigestUtils.sha256Hex(rawToken);
    }
}
```

#### ğŸ” è‡ªå®šä¹‰åŠ å¯†Token


```java
public class CustomTokenGenerator {
    
    private static final String SECRET_KEY = "my_super_secret_key_2024";
    
    /**
     * ç”Ÿæˆè‡ªå®šä¹‰åŠ å¯†Token
     * åŒ…å«ï¼šç”¨æˆ·ID + è¿‡æœŸæ—¶é—´ + ç­¾å
     */
    public static String generateCustomToken(Long userId) {
        long expireTime = System.currentTimeMillis() + (24 * 60 * 60 * 1000); // 24å°æ—¶
        
        // æ„é€ Tokenè½½è·
        String payload = userId + ":" + expireTime;
        
        // ä½¿ç”¨HMAC-SHA256ç­¾å
        String signature = createSignature(payload, SECRET_KEY);
        
        // Base64ç¼–ç æœ€ç»ˆToken
        String finalToken = payload + ":" + signature;
        return Base64.getEncoder().encodeToString(finalToken.getBytes());
    }
    
    private static String createSignature(String data, String key) {
        // ç®€åŒ–çš„HMACå®ç°
        return DigestUtils.sha256Hex(data + key);
    }
}
```

### 2.3 Tokenç»“æ„è®¾è®¡


**æ¨èçš„Tokenç»“æ„**ï¼š

```
Tokenç»„æˆéƒ¨åˆ†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ ‡è¯†    â”‚   è¿‡æœŸæ—¶é—´    â”‚  æƒé™ä¿¡æ¯   â”‚   æ•°å­—ç­¾å    â”‚
â”‚   8ä½       â”‚    13ä½      â”‚    å˜é•¿     â”‚    32ä½      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¤ºä¾‹Tokenè§£æï¼š
12345678:1692259200000:admin,user:a1b2c3d4e5f6...
   â”‚           â”‚          â”‚         â”‚
   â”‚           â”‚          â”‚         â””â”€â”€ é˜²ç¯¡æ”¹ç­¾å
   â”‚           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç”¨æˆ·è§’è‰²æƒé™
   â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¿‡æœŸæ—¶é—´æˆ³
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç”¨æˆ·ID
```

### 2.4 ç”Ÿæˆç­–ç•¥å¯¹æ¯”


| ç­–ç•¥ç±»å‹ | **å®‰å…¨æ€§** | **æ€§èƒ½** | **å­˜å‚¨éœ€æ±‚** | **é€‚ç”¨åœºæ™¯** |
|---------|-----------|---------|-------------|-------------|
| ğŸ² **çº¯éšæœºUUID** | `é«˜` | `æé«˜` | `éœ€è¦æ•°æ®åº“å­˜å‚¨` | `é«˜å¹¶å‘ç³»ç»Ÿ` |
| ğŸ” **è‡ªç­¾åToken** | `å¾ˆé«˜` | `é«˜` | `æ— éœ€å­˜å‚¨` | `åˆ†å¸ƒå¼ç³»ç»Ÿ` |
| ğŸ·ï¸ **JWT Token** | `é«˜` | `ä¸­` | `æ— éœ€å­˜å‚¨` | `å¾®æœåŠ¡æ¶æ„` |

---

## 3. ğŸ“¦ Tokenå­˜å‚¨ä¸ä¼ è¾“


### 3.1 å®¢æˆ·ç«¯Tokenå­˜å‚¨æ–¹æ¡ˆ


#### ğŸª Cookieå­˜å‚¨


```javascript
// Cookieå­˜å‚¨æ–¹æ¡ˆ
class CookieTokenStorage {
    
    // å­˜å‚¨Tokenåˆ°Cookie
    static saveToken(token) {
        document.cookie = `auth_token=${token}; path=/; max-age=86400; secure; httpOnly`;
        //                     â†‘              â†‘       â†‘        â†‘       â†‘
        //                   Tokenå€¼        å…¨ç«™æœ‰æ•ˆ  24å°æ—¶   HTTPS   é˜²XSS
    }
    
    // ä»Cookieè¯»å–Token
    static getToken() {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            const [name, value] = cookie.trim().split('=');
            if (name === 'auth_token') {
                return value;
            }
        }
        return null;
    }
}
```

> âš ï¸ **Cookieå­˜å‚¨æ³¨æ„äº‹é¡¹**ï¼š
> - âœ… **ä¼˜ç‚¹**ï¼šè‡ªåŠ¨å‘é€ï¼Œé˜²XSSæ”»å‡»
> - âŒ **ç¼ºç‚¹**ï¼šå®¹æ˜“å—CSRFæ”»å‡»ï¼Œæœ‰å¤§å°é™åˆ¶

#### ğŸ’¾ localStorageå­˜å‚¨


```javascript
// localStorageå­˜å‚¨æ–¹æ¡ˆ
class LocalStorageTokenStorage {
    
    // å­˜å‚¨Token
    static saveToken(token, userInfo) {
        const tokenData = {
            token: token,
            userInfo: userInfo,
            timestamp: Date.now()
        };
        localStorage.setItem('auth_data', JSON.stringify(tokenData));
    }
    
    // è¯»å–Token
    static getToken() {
        const authData = localStorage.getItem('auth_data');
        if (authData) {
            const data = JSON.parse(authData);
            return data.token;
        }
        return null;
    }
    
    // æ¸…é™¤Token
    static clearToken() {
        localStorage.removeItem('auth_data');
    }
}
```

> ğŸ’¡ **localStorageç‰¹ç‚¹**ï¼š
> - âœ… **ä¼˜ç‚¹**ï¼šå®¹é‡å¤§ï¼ŒæŒä¹…å­˜å‚¨ï¼Œçµæ´»æ§åˆ¶
> - âš ï¸ **æ³¨æ„**ï¼šå®¹æ˜“å—XSSæ”»å‡»ï¼Œéœ€è¦é¢å¤–é˜²æŠ¤

### 3.2 Tokenä¼ è¾“æ–¹å¼


#### ğŸ“¡ HTTP Headerä¼ è¾“ï¼ˆæ¨èï¼‰


```javascript
// å‰ç«¯å‘é€è¯·æ±‚æ—¶æºå¸¦Token
class ApiClient {
    
    static async makeRequest(url, options = {}) {
        const token = LocalStorageTokenStorage.getToken();
        
        const headers = {
            'Content-Type': 'application/json',
            // æ ‡å‡†çš„Bearer Tokenæ ¼å¼
            'Authorization': `Bearer ${token}`,
            ...options.headers
        };
        
        return fetch(url, {
            ...options,
            headers
        });
    }
}
```

```java
// åç«¯è§£æHeaderä¸­çš„Token
@RestController
public class ApiController {
    
    @GetMapping("/user/profile")
    public ResponseEntity<?> getUserProfile(HttpServletRequest request) {
        // ä»è¯·æ±‚å¤´è·å–Token
        String authHeader = request.getHeader("Authorization");
        
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            String token = authHeader.substring(7); // å»æ‰"Bearer "å‰ç¼€
            
            // éªŒè¯Token
            if (tokenService.validateToken(token)) {
                User user = tokenService.getUserFromToken(token);
                return ResponseEntity.ok(user);
            }
        }
        
        return ResponseEntity.status(401).body("Tokenæ— æ•ˆ");
    }
}
```

#### ğŸ”— URLå‚æ•°ä¼ è¾“ï¼ˆä¸æ¨èï¼‰


```javascript
// URLå‚æ•°æ–¹å¼ï¼ˆä»…ä¾›äº†è§£ï¼Œå®é™…ä¸å»ºè®®ä½¿ç”¨ï¼‰
const url = `https://api.example.com/user?token=${token}`;

// é—®é¢˜ï¼š
// 1. Tokenä¼šå‡ºç°åœ¨æ—¥å¿—ä¸­ï¼Œæœ‰å®‰å…¨é£é™©
// 2. URLæœ‰é•¿åº¦é™åˆ¶
// 3. å®¹æ˜“è¢«æ„å¤–åˆ†äº«æ³„éœ²
```

### 3.3 ä¼ è¾“å®‰å…¨æœ€ä½³å®è·µ


```
ğŸ”’ HTTPSä¼ è¾“ï¼š
- æ‰€æœ‰Tokenä¼ è¾“å¿…é¡»ä½¿ç”¨HTTPS
- é˜²æ­¢ä¸­é—´äººæ”»å‡»çªƒå–Token

ğŸ·ï¸ Headeræ ¼å¼æ ‡å‡†ï¼š
Authorization: Bearer <token>
- ä½¿ç”¨æ ‡å‡†çš„Bearer Tokenæ ¼å¼
- ä¾¿äºå„ç§å·¥å…·å’Œæ¡†æ¶è¯†åˆ«

ğŸ›¡ï¸ è¯·æ±‚éªŒè¯ï¼š
- éªŒè¯è¯·æ±‚æ¥æº
- æ£€æŸ¥User-Agentç­‰å¤´ä¿¡æ¯
- å®æ–½é¢‘ç‡é™åˆ¶
```

---

## 4. â° æœ‰æ•ˆæœŸè®¾ç½®ç­–ç•¥


### 4.1 Tokenæœ‰æ•ˆæœŸçš„é‡è¦æ€§


> ğŸ¯ **æ ¸å¿ƒåŸåˆ™**ï¼šTokenå°±åƒ**ä¸´æ—¶é€šè¡Œè¯**ï¼Œå¿…é¡»è®¾å®šåˆç†çš„æœ‰æ•ˆæœŸæ¥å¹³è¡¡**ç”¨æˆ·ä½“éªŒ**å’Œ**å®‰å…¨æ€§**

**å®‰å…¨è€ƒè™‘**ï¼š
- Tokenæœ‰æ•ˆæœŸè¿‡é•¿ï¼šä¸€æ—¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥é•¿æ—¶é—´ä½¿ç”¨
- Tokenæœ‰æ•ˆæœŸè¿‡çŸ­ï¼šç”¨æˆ·éœ€è¦é¢‘ç¹é‡æ–°ç™»å½•ï¼Œä½“éªŒå·®

### 4.2 ä¸åŒåœºæ™¯çš„æœ‰æ•ˆæœŸç­–ç•¥


```
ğŸ“± ç§»åŠ¨ç«¯APPï¼š
- è®¿é—®Tokenï¼š2-4å°æ—¶
- åˆ·æ–°Tokenï¼š30å¤©
- åŸå› ï¼šç§»åŠ¨ç«¯ç›¸å¯¹å®‰å…¨ï¼Œå¯ä»¥é€‚å½“å»¶é•¿

ğŸ–¥ï¸ Webç½‘ç«™ï¼š
- è®¿é—®Tokenï¼š30åˆ†é’Ÿ-2å°æ—¶  
- åˆ·æ–°Tokenï¼š7-15å¤©
- åŸå› ï¼šæµè§ˆå™¨ç¯å¢ƒé£é™©è¾ƒé«˜

ğŸ¢ ä¼ä¸šå†…ç½‘ï¼š
- è®¿é—®Tokenï¼š8å°æ—¶ï¼ˆå·¥ä½œæ—¶é—´ï¼‰
- åˆ·æ–°Tokenï¼š30å¤©
- åŸå› ï¼šå†…ç½‘ç¯å¢ƒç›¸å¯¹å®‰å…¨

ğŸ¦ é‡‘èç³»ç»Ÿï¼š
- è®¿é—®Tokenï¼š15-30åˆ†é’Ÿ
- åˆ·æ–°Tokenï¼š1å¤©
- åŸå› ï¼šå®‰å…¨æ€§è¦æ±‚æé«˜
```

### 4.3 åŒTokenæœºåˆ¶å®ç°


```java
@Service
public class TokenService {
    
    /**
     * ç”Ÿæˆè®¿é—®Tokenå’Œåˆ·æ–°Token
     */
    public TokenPair generateTokenPair(Long userId) {
        // çŸ­æœŸè®¿é—®Tokenï¼ˆ2å°æ—¶ï¼‰
        String accessToken = createAccessToken(userId, 2 * 60 * 60 * 1000);
        
        // é•¿æœŸåˆ·æ–°Tokenï¼ˆ30å¤©ï¼‰
        String refreshToken = createRefreshToken(userId, 30 * 24 * 60 * 60 * 1000);
        
        return new TokenPair(accessToken, refreshToken);
    }
    
    /**
     * ä½¿ç”¨åˆ·æ–°Tokenè·å–æ–°çš„è®¿é—®Token
     */
    public String refreshAccessToken(String refreshToken) {
        if (!validateRefreshToken(refreshToken)) {
            throw new SecurityException("åˆ·æ–°Tokenæ— æ•ˆ");
        }
        
        Long userId = getUserIdFromToken(refreshToken);
        return createAccessToken(userId, 2 * 60 * 60 * 1000);
    }
}
```

```javascript
// å‰ç«¯è‡ªåŠ¨åˆ·æ–°Tokenæœºåˆ¶
class TokenManager {
    
    static async makeAuthenticatedRequest(url, options) {
        let accessToken = this.getAccessToken();
        
        // æ£€æŸ¥Tokenæ˜¯å¦å³å°†è¿‡æœŸ
        if (this.isTokenExpiringSoon(accessToken)) {
            accessToken = await this.refreshToken();
        }
        
        return fetch(url, {
            ...options,
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                ...options.headers
            }
        });
    }
    
    static async refreshToken() {
        const refreshToken = this.getRefreshToken();
        
        const response = await fetch('/auth/refresh', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${refreshToken}`
            }
        });
        
        if (response.ok) {
            const { accessToken } = await response.json();
            this.saveAccessToken(accessToken);
            return accessToken;
        } else {
            // åˆ·æ–°å¤±è´¥ï¼Œéœ€è¦é‡æ–°ç™»å½•
            this.redirectToLogin();
        }
    }
}
```

### 4.4 åŠ¨æ€æœ‰æ•ˆæœŸç­–ç•¥


```java
/**
 * æ ¹æ®ç”¨æˆ·è¡Œä¸ºåŠ¨æ€è°ƒæ•´Tokenæœ‰æ•ˆæœŸ
 */
@Component
public class DynamicTokenManager {
    
    public String generateAdaptiveToken(Long userId, String userRole, String clientType) {
        long baseExpiration = 2 * 60 * 60 * 1000; // åŸºç¡€2å°æ—¶
        
        // æ ¹æ®ç”¨æˆ·è§’è‰²è°ƒæ•´
        if ("admin".equals(userRole)) {
            baseExpiration /= 2; // ç®¡ç†å‘˜Tokenæœ‰æ•ˆæœŸå‡åŠ
        } else if ("vip".equals(userRole)) {
            baseExpiration *= 2; // VIPç”¨æˆ·æœ‰æ•ˆæœŸç¿»å€
        }
        
        // æ ¹æ®å®¢æˆ·ç«¯ç±»å‹è°ƒæ•´
        if ("mobile".equals(clientType)) {
            baseExpiration *= 3; // ç§»åŠ¨ç«¯å»¶é•¿æœ‰æ•ˆæœŸ
        }
        
        return createTokenWithExpiration(userId, baseExpiration);
    }
    
    /**
     * åŸºäºç”¨æˆ·æ´»è·ƒåº¦åŠ¨æ€å»¶é•¿Token
     */
    public void extendTokenIfActive(String token, String userId) {
        UserActivity activity = userActivityService.getRecentActivity(userId);
        
        // å¦‚æœç”¨æˆ·åœ¨æœ€è¿‘5åˆ†é’Ÿå†…å¾ˆæ´»è·ƒï¼Œå»¶é•¿Token 30åˆ†é’Ÿ
        if (activity.isActiveInLastMinutes(5)) {
            extendTokenExpiration(token, 30 * 60 * 1000);
        }
    }
}
```

---

## 5. ğŸš« Tokenæ’¤é”€ä¸é»‘åå•æœºåˆ¶


### 5.1 Tokenæ’¤é”€çš„å¿…è¦æ€§


> ğŸ”’ **å®‰å…¨è¦æ±‚**ï¼šå½“ç”¨æˆ·ä¸»åŠ¨ç™»å‡ºã€è´¦æˆ·è¢«ç¦ç”¨ã€æˆ–å‘ç°Tokenæ³„éœ²æ—¶ï¼Œå¿…é¡»èƒ½å¤Ÿ**ç«‹å³åºŸé™¤**è¯¥Tokençš„æœ‰æ•ˆæ€§

**éœ€è¦æ’¤é”€Tokençš„åœºæ™¯**ï¼š
- ğŸšª ç”¨æˆ·ä¸»åŠ¨ç™»å‡º
- ğŸ”’ ç”¨æˆ·ä¿®æ”¹å¯†ç   
- ğŸ‘¤ ç®¡ç†å‘˜ç¦ç”¨è´¦æˆ·
- ğŸš¨ æ£€æµ‹åˆ°å¼‚å¸¸ç™»å½•
- ğŸ“± ç”¨æˆ·æ›´æ¢è®¾å¤‡

### 5.2 é»‘åå•æœºåˆ¶å®ç°


#### ğŸ“‹ Redisé»‘åå•æ–¹æ¡ˆ


```java
@Service
public class TokenBlacklistService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    /**
     * å°†TokenåŠ å…¥é»‘åå•
     */
    public void blacklistToken(String token) {
        // è§£æTokenè·å–è¿‡æœŸæ—¶é—´
        long expiration = getTokenExpiration(token);
        long remainingTime = expiration - System.currentTimeMillis();
        
        if (remainingTime > 0) {
            // åœ¨Redisä¸­å­˜å‚¨é»‘åå•Tokenï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
            redisTemplate.opsForValue().set(
                "blacklist:" + token, 
                "revoked", 
                remainingTime, 
                TimeUnit.MILLISECONDS
            );
        }
    }
    
    /**
     * æ£€æŸ¥Tokenæ˜¯å¦åœ¨é»‘åå•ä¸­
     */
    public boolean isTokenBlacklisted(String token) {
        return redisTemplate.hasKey("blacklist:" + token);
    }
    
    /**
     * æ‰¹é‡æ’¤é”€ç”¨æˆ·çš„æ‰€æœ‰Token
     */
    public void revokeAllUserTokens(Long userId) {
        // è®°å½•æ’¤é”€æ—¶é—´æˆ³ï¼Œè¿™ä¸ªæ—¶é—´ä¹‹å‰çš„æ‰€æœ‰Tokenéƒ½æ— æ•ˆ
        String key = "user_revoke_time:" + userId;
        redisTemplate.opsForValue().set(key, String.valueOf(System.currentTimeMillis()));
    }
    
    /**
     * éªŒè¯Tokenæ—¶æ£€æŸ¥æ˜¯å¦è¢«æ’¤é”€
     */
    public boolean validateTokenNotRevoked(String token, Long userId) {
        // 1. æ£€æŸ¥Tokené»‘åå•
        if (isTokenBlacklisted(token)) {
            return false;
        }
        
        // 2. æ£€æŸ¥ç”¨æˆ·çº§åˆ«çš„æ’¤é”€æ—¶é—´
        String revokeTimeStr = redisTemplate.opsForValue().get("user_revoke_time:" + userId);
        if (revokeTimeStr != null) {
            long revokeTime = Long.parseLong(revokeTimeStr);
            long tokenCreatedTime = getTokenCreatedTime(token);
            
            if (tokenCreatedTime < revokeTime) {
                return false; // Tokenåˆ›å»ºæ—¶é—´æ—©äºæ’¤é”€æ—¶é—´
            }
        }
        
        return true;
    }
}
```

#### ğŸ’¾ æ•°æ®åº“é»‘åå•æ–¹æ¡ˆ


```java
@Entity
@Table(name = "token_blacklist")
public class TokenBlacklist {
    
    @Id
    private String tokenHash;      // Tokençš„å“ˆå¸Œå€¼ï¼ˆéšç§ä¿æŠ¤ï¼‰
    
    @Column(name = "user_id")
    private Long userId;
    
    @Column(name = "revoked_at")
    private LocalDateTime revokedAt;  // æ’¤é”€æ—¶é—´
    
    @Column(name = "reason")
    private String reason;            // æ’¤é”€åŸå› 
    
    @Column(name = "expires_at")
    private LocalDateTime expiresAt;  // TokenåŸæœ¬çš„è¿‡æœŸæ—¶é—´
    
    // getter/setter...
}

@Repository
public interface TokenBlacklistRepository extends JpaRepository<TokenBlacklist, String> {
    
    // æ£€æŸ¥Tokenæ˜¯å¦åœ¨é»‘åå•
    boolean existsByTokenHash(String tokenHash);
    
    // æ¸…ç†è¿‡æœŸçš„é»‘åå•è®°å½•ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
    @Modifying
    @Query("DELETE FROM TokenBlacklist t WHERE t.expiresAt < :now")
    void deleteExpiredTokens(@Param("now") LocalDateTime now);
}
```

### 5.3 æ™ºèƒ½æ’¤é”€ç­–ç•¥


```java
@Service
public class SmartTokenRevocationService {
    
    /**
     * æ™ºèƒ½æ£€æµ‹å¼‚å¸¸ç™»å½•å¹¶è‡ªåŠ¨æ’¤é”€Token
     */
    public void checkAndRevokeAbnormalTokens(Long userId, String currentIp, String userAgent) {
        List<ActiveToken> userTokens = getActiveUserTokens(userId);
        
        for (ActiveToken token : userTokens) {
            // æ£€æŸ¥IPåœ°å€å˜åŒ–
            if (isIpLocationChanged(token.getIp(), currentIp)) {
                revokeTokenWithReason(token.getToken(), "å¼‚å¸¸IPç™»å½•");
            }
            
            // æ£€æŸ¥è®¾å¤‡æŒ‡çº¹å˜åŒ–
            if (isDeviceChanged(token.getUserAgent(), userAgent)) {
                revokeTokenWithReason(token.getToken(), "è®¾å¤‡å˜æ›´");
            }
            
            // æ£€æŸ¥åŒæ—¶åœ¨çº¿è®¾å¤‡æ•°
            if (userTokens.size() > getMaxDeviceLimit(userId)) {
                revokeOldestToken(userTokens);
            }
        }
    }
    
    /**
     * æ¸è¿›å¼æ’¤é”€ç­–ç•¥
     */
    public void gracefulTokenRevocation(String token, String reason) {
        // 1. å…ˆé™çº§æƒé™ï¼Œè€Œä¸æ˜¯ç«‹å³æ’¤é”€
        downgradeTokenPermissions(token);
        
        // 2. ç»™ç”¨æˆ·å‘é€å®‰å…¨æé†’
        sendSecurityAlert(getUserIdFromToken(token), reason);
        
        // 3. åœ¨å®½é™æœŸåæ‰å®Œå…¨æ’¤é”€
        scheduleTokenRevocation(token, Duration.ofMinutes(15));
    }
}
```

### 5.4 æ’¤é”€æœºåˆ¶å¯¹æ¯”


| æ–¹æ¡ˆ | **æ€§èƒ½** | **å­˜å‚¨æˆæœ¬** | **å®æ—¶æ€§** | **é€‚ç”¨åœºæ™¯** |
|------|---------|-------------|-----------|-------------|
| ğŸ”¥ **Redisé»‘åå•** | `æé«˜` | `ä½` | `å®æ—¶` | `é«˜å¹¶å‘ç³»ç»Ÿ` |
| ğŸ’¾ **æ•°æ®åº“é»‘åå•** | `ä¸­ç­‰` | `é«˜` | `å‡†å®æ—¶` | `æ•°æ®æŒä¹…åŒ–è¦æ±‚é«˜` |
| â° **Tokenç‰ˆæœ¬æ§åˆ¶** | `é«˜` | `æä½` | `å®æ—¶` | `ç®€å•ç³»ç»Ÿ` |
| ğŸ¯ **çŸ­æœŸToken** | `æé«˜` | `æ— ` | `è‡ªç„¶è¿‡æœŸ` | `å®‰å…¨è¦æ±‚é«˜` |

---

## 6. ğŸ› ï¸ è‡ªå®šä¹‰Tokenè®¤è¯ç³»ç»Ÿå®æˆ˜


### 6.1 ç³»ç»Ÿæ¶æ„è®¾è®¡


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å®¢æˆ·ç«¯        â”‚    â”‚    è®¤è¯æœåŠ¡      â”‚    â”‚     ä¸šåŠ¡æœåŠ¡     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç™»å½•ç•Œé¢       â”‚    â”‚ â€¢ Tokenç”Ÿæˆ     â”‚    â”‚ â€¢ ç”¨æˆ·ç®¡ç†       â”‚
â”‚ â€¢ Tokenå­˜å‚¨     â”‚â—„â”€â”€â–ºâ”‚ â€¢ TokenéªŒè¯     â”‚â—„â”€â”€â–ºâ”‚ â€¢ æƒé™æ§åˆ¶       â”‚
â”‚ â€¢ è‡ªåŠ¨åˆ·æ–°      â”‚    â”‚ â€¢ é»‘åå•ç®¡ç†     â”‚    â”‚ â€¢ ä¸šåŠ¡é€»è¾‘       â”‚
â”‚ â€¢ å¼‚å¸¸å¤„ç†      â”‚    â”‚ â€¢ å®‰å…¨ç›‘æ§      â”‚    â”‚ â€¢ æ•°æ®è®¿é—®       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ•°æ®å­˜å‚¨å±‚     â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ ç”¨æˆ·ä¿¡æ¯       â”‚
                    â”‚ â€¢ Tokené»‘åå•   â”‚
                    â”‚ â€¢ ç™»å½•æ—¥å¿—       â”‚
                    â”‚ â€¢ æƒé™é…ç½®       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ ¸å¿ƒç»„ä»¶å®ç°


#### ğŸ” Tokenç”Ÿæˆå™¨


```java
@Component
public class CustomTokenGenerator {
    
    private static final String SECRET = "my_app_secret_key_2024";
    private final ObjectMapper objectMapper = new ObjectMapper();
    
    /**
     * ç”Ÿæˆå®Œæ•´çš„Tokenï¼ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
     */
    public String generateToken(User user) {
        try {
            // æ„å»ºTokenè½½è·
            TokenPayload payload = TokenPayload.builder()
                .userId(user.getId())
                .username(user.getUsername())
                .roles(user.getRoles())
                .permissions(user.getPermissions())
                .issuedAt(System.currentTimeMillis())
                .expiresAt(System.currentTimeMillis() + 2 * 60 * 60 * 1000) // 2å°æ—¶
                .build();
            
            // è½¬æ¢ä¸ºJSON
            String jsonPayload = objectMapper.writeValueAsString(payload);
            
            // Base64ç¼–ç 
            String encodedPayload = Base64.getEncoder().encodeToString(jsonPayload.getBytes());
            
            // ç”Ÿæˆç­¾å
            String signature = generateSignature(encodedPayload);
            
            // ç»„åˆæœ€ç»ˆToken
            return encodedPayload + "." + signature;
            
        } catch (Exception e) {
            throw new RuntimeException("Tokenç”Ÿæˆå¤±è´¥", e);
        }
    }
    
    private String generateSignature(String payload) {
        return DigestUtils.sha256Hex(payload + SECRET);
    }
}
```

#### ğŸ›¡ï¸ TokenéªŒè¯å™¨


```java
@Component
public class TokenValidator {
    
    @Autowired
    private TokenBlacklistService blacklistService;
    
    /**
     * å®Œæ•´çš„TokenéªŒè¯æµç¨‹
     */
    public TokenValidationResult validateToken(String token) {
        try {
            // 1. åŸºæœ¬æ ¼å¼éªŒè¯
            if (!isValidTokenFormat(token)) {
                return TokenValidationResult.invalid("Tokenæ ¼å¼é”™è¯¯");
            }
            
            // 2. ç­¾åéªŒè¯
            if (!verifySignature(token)) {
                return TokenValidationResult.invalid("Tokenç­¾åæ— æ•ˆ");
            }
            
            // 3. è§£æè½½è·
            TokenPayload payload = parseTokenPayload(token);
            
            // 4. è¿‡æœŸæ—¶é—´éªŒè¯
            if (payload.getExpiresAt() < System.currentTimeMillis()) {
                return TokenValidationResult.expired("Tokenå·²è¿‡æœŸ");
            }
            
            // 5. é»‘åå•æ£€æŸ¥
            if (blacklistService.isTokenBlacklisted(token)) {
                return TokenValidationResult.revoked("Tokenå·²è¢«æ’¤é”€");
            }
            
            // 6. ç”¨æˆ·çŠ¶æ€æ£€æŸ¥
            if (!isUserActive(payload.getUserId())) {
                return TokenValidationResult.invalid("ç”¨æˆ·è´¦æˆ·å·²ç¦ç”¨");
            }
            
            return TokenValidationResult.valid(payload);
            
        } catch (Exception e) {
            return TokenValidationResult.invalid("TokenéªŒè¯å¼‚å¸¸ï¼š" + e.getMessage());
        }
    }
    
    private TokenPayload parseTokenPayload(String token) {
        String[] parts = token.split("\\.");
        String encodedPayload = parts[0];
        
        byte[] decodedBytes = Base64.getDecoder().decode(encodedPayload);
        String jsonPayload = new String(decodedBytes);
        
        return objectMapper.readValue(jsonPayload, TokenPayload.class);
    }
}
```

#### ğŸ”„ è®¤è¯æ‹¦æˆªå™¨


```java
@Component
public class TokenAuthenticationInterceptor implements HandlerInterceptor {
    
    @Autowired
    private TokenValidator tokenValidator;
    
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, 
                           Object handler) throws Exception {
        
        // è·³è¿‡ä¸éœ€è¦è®¤è¯çš„æ¥å£
        if (isPublicEndpoint(request.getRequestURI())) {
            return true;
        }
        
        // è·å–Token
        String token = extractToken(request);
        if (token == null) {
            sendErrorResponse(response, 401, "ç¼ºå°‘è®¤è¯Token");
            return false;
        }
        
        // éªŒè¯Token
        TokenValidationResult result = tokenValidator.validateToken(token);
        if (!result.isValid()) {
            sendErrorResponse(response, 401, result.getErrorMessage());
            return false;
        }
        
        // å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥è¯·æ±‚ä¸Šä¸‹æ–‡
        TokenPayload payload = result.getPayload();
        UserContext.setCurrentUser(payload);
        
        return true;
    }
    
    private String extractToken(HttpServletRequest request) {
        String authHeader = request.getHeader("Authorization");
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            return authHeader.substring(7);
        }
        return null;
    }
}
```

### 6.3 å®Œæ•´çš„è®¤è¯æµç¨‹


```java
@RestController
@RequestMapping("/auth")
public class AuthController {
    
    @Autowired
    private UserService userService;
    @Autowired
    private CustomTokenGenerator tokenGenerator;
    @Autowired
    private TokenBlacklistService blacklistService;
    
    /**
     * ç”¨æˆ·ç™»å½•
     */
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest request) {
        try {
            // 1. éªŒè¯ç”¨æˆ·å‡­æ®
            User user = userService.authenticate(request.getUsername(), request.getPassword());
            if (user == null) {
                return ResponseEntity.status(401).body("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            }
            
            // 2. ç”ŸæˆToken
            String accessToken = tokenGenerator.generateToken(user);
            String refreshToken = tokenGenerator.generateRefreshToken(user);
            
            // 3. è®°å½•ç™»å½•æ—¥å¿—
            logUserLogin(user, request.getClientInfo());
            
            // 4. è¿”å›è®¤è¯ç»“æœ
            AuthResponse response = AuthResponse.builder()
                .accessToken(accessToken)
                .refreshToken(refreshToken)
                .userInfo(UserInfo.from(user))
                .expiresIn(2 * 60 * 60) // 2å°æ—¶
                .build();
                
            return ResponseEntity.ok(response);
            
        } catch (Exception e) {
            return ResponseEntity.status(500).body("ç™»å½•å¤±è´¥ï¼š" + e.getMessage());
        }
    }
    
    /**
     * ç”¨æˆ·ç™»å‡º
     */
    @PostMapping("/logout")
    public ResponseEntity<?> logout(HttpServletRequest request) {
        String token = extractToken(request);
        if (token != null) {
            // å°†TokenåŠ å…¥é»‘åå•
            blacklistService.blacklistToken(token);
        }
        
        return ResponseEntity.ok("ç™»å‡ºæˆåŠŸ");
    }
    
    /**
     * åˆ·æ–°Token
     */
    @PostMapping("/refresh")
    public ResponseEntity<?> refreshToken(@RequestBody RefreshTokenRequest request) {
        TokenValidationResult result = tokenValidator.validateRefreshToken(request.getRefreshToken());
        
        if (result.isValid()) {
            User user = userService.findById(result.getPayload().getUserId());
            String newAccessToken = tokenGenerator.generateToken(user);
            
            return ResponseEntity.ok(Map.of("accessToken", newAccessToken));
        } else {
            return ResponseEntity.status(401).body("åˆ·æ–°Tokenæ— æ•ˆ");
        }
    }
}
```

### 6.4 å‰ç«¯é›†æˆç¤ºä¾‹


```javascript
class AuthService {
    
    constructor() {
        this.baseURL = '/api';
        this.tokenStorage = new TokenStorage();
    }
    
    /**
     * ç”¨æˆ·ç™»å½•
     */
    async login(username, password) {
        try {
            const response = await fetch(`${this.baseURL}/auth/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            });
            
            if (response.ok) {
                const data = await response.json();
                
                // ä¿å­˜Token
                this.tokenStorage.saveTokens(data.accessToken, data.refreshToken);
                
                // è®¾ç½®è‡ªåŠ¨åˆ·æ–°
                this.setupTokenRefresh(data.expiresIn);
                
                return { success: true, user: data.userInfo };
            } else {
                const error = await response.text();
                return { success: false, error };
            }
        } catch (error) {
            return { success: false, error: 'ç½‘ç»œé”™è¯¯' };
        }
    }
    
    /**
     * è‡ªåŠ¨Tokenåˆ·æ–°æœºåˆ¶
     */
    setupTokenRefresh(expiresIn) {
        // åœ¨Tokenè¿‡æœŸå‰5åˆ†é’Ÿåˆ·æ–°
        const refreshTime = (expiresIn - 300) * 1000;
        
        setTimeout(async () => {
            const refreshed = await this.refreshToken();
            if (refreshed) {
                // ç»§ç»­è®¾ç½®ä¸‹æ¬¡åˆ·æ–°
                this.setupTokenRefresh(7200); // 2å°æ—¶
            } else {
                // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
                this.redirectToLogin();
            }
        }, refreshTime);
    }
    
    /**
     * æºå¸¦Tokençš„APIè¯·æ±‚
     */
    async authenticatedFetch(url, options = {}) {
        const token = this.tokenStorage.getAccessToken();
        
        const headers = {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`,
            ...options.headers
        };
        
        const response = await fetch(url, {
            ...options,
            headers
        });
        
        // å¦‚æœTokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°
        if (response.status === 401) {
            const refreshed = await this.refreshToken();
            if (refreshed) {
                // é‡æ–°å‘é€è¯·æ±‚
                return this.authenticatedFetch(url, options);
            } else {
                this.redirectToLogin();
            }
        }
        
        return response;
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ” Tokenè®¤è¯æœ¬è´¨ï¼š
â€¢ Tokenæ˜¯ç”¨æˆ·èº«ä»½çš„æ•°å­—å‡­è¯
â€¢ æ— çŠ¶æ€è®¤è¯ï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ç”¨æˆ·ç™»å½•çŠ¶æ€
â€¢ é€šè¿‡åŠ å¯†ç­¾åé˜²æ­¢ä¼ªé€ å’Œç¯¡æ”¹

ğŸ² ä»¤ç‰Œç”ŸæˆåŸåˆ™ï¼š
â€¢ ä½¿ç”¨å¼ºéšæœºæ•°ä¿è¯ä¸å¯é¢„æµ‹æ€§
â€¢ åŒ…å«å¿…è¦çš„ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
â€¢ æ·»åŠ æ•°å­—ç­¾åé˜²æ­¢ç¯¡æ”¹

ğŸ“¦ å­˜å‚¨ä¼ è¾“å®‰å…¨ï¼š
â€¢ å®¢æˆ·ç«¯åˆç†é€‰æ‹©å­˜å‚¨æ–¹å¼ï¼ˆlocalStorage vs Cookieï¼‰
â€¢ ä½¿ç”¨HTTPSå’Œæ ‡å‡†Beareræ ¼å¼ä¼ è¾“
â€¢ å®æ–½é€‚å½“çš„é˜²æŠ¤æªæ–½

â° æœ‰æ•ˆæœŸç­–ç•¥ï¼š
â€¢ å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ
â€¢ å®æ–½åŒTokenæœºåˆ¶ï¼ˆè®¿é—®+åˆ·æ–°ï¼‰
â€¢ æ ¹æ®ä¸šåŠ¡åœºæ™¯è°ƒæ•´è¿‡æœŸæ—¶é—´
```

### 7.2 å®æˆ˜åº”ç”¨è¦ç‚¹


**ğŸ”¹ å®‰å…¨æ€§æœ€ä½³å®è·µ**
```
ç”Ÿæˆå®‰å…¨ï¼š
â€¢ ä½¿ç”¨åŠ å¯†çº§éšæœºæ•°ç”Ÿæˆå™¨
â€¢ å®æ–½å¼ºç­¾åç®—æ³•ï¼ˆHMAC-SHA256ï¼‰
â€¢ å®šæœŸè½®æ¢ç­¾åå¯†é’¥

ä¼ è¾“å®‰å…¨ï¼š
â€¢ å¼ºåˆ¶HTTPSä¼ è¾“
â€¢ ä½¿ç”¨æ ‡å‡†Authorizationå¤´
â€¢ å®æ–½è¯·æ±‚é¢‘ç‡é™åˆ¶

å­˜å‚¨å®‰å…¨ï¼š
â€¢ å®¢æˆ·ç«¯é¿å…æ˜æ–‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
â€¢ å®æ–½Tokené»‘åå•æœºåˆ¶
â€¢ ç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸º
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
```
ç¼“å­˜ç­–ç•¥ï¼š
â€¢ ä½¿ç”¨Redisç¼“å­˜TokenéªŒè¯ç»“æœ
â€¢ å®æ–½æ™ºèƒ½çš„é»‘åå•ç®¡ç†
â€¢ ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

å¹¶å‘å¤„ç†ï¼š
â€¢ ä½¿ç”¨æ— é”çš„TokenéªŒè¯ç®—æ³•
â€¢ å®æ–½åˆ†å¸ƒå¼Tokenç®¡ç†
â€¢ ä¼˜åŒ–é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½
```

**ğŸ”¹ ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
```
è‡ªåŠ¨åŒ–å¤„ç†ï¼š
â€¢ å‰ç«¯è‡ªåŠ¨åˆ·æ–°Token
â€¢ æ™ºèƒ½çš„ç™»å½•çŠ¶æ€ä¿æŒ
â€¢ å‹å¥½çš„é”™è¯¯æç¤ºå’Œå¼•å¯¼

çµæ´»é…ç½®ï¼š
â€¢ æ ¹æ®ç”¨æˆ·è§’è‰²è°ƒæ•´ç­–ç•¥
â€¢ æ”¯æŒå¤šè®¾å¤‡åŒæ—¶ç™»å½•
â€¢ å®æ–½æ¸è¿›å¼å®‰å…¨ç­–ç•¥
```

### 7.3 å¸¸è§é—®é¢˜è§£å†³


> â“ **Tokenè¢«ç›—ç”¨æ€ä¹ˆåŠï¼Ÿ**
> 
> ğŸ’¡ **è§£å†³æ–¹æ¡ˆ**ï¼š
> - å®æ–½IPåœ°å€éªŒè¯
> - ç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸º  
> - å¿«é€Ÿæ’¤é”€å¯ç–‘Token
> - é€šçŸ¥ç”¨æˆ·å®‰å…¨é£é™©

> â“ **å¦‚ä½•å¤„ç†Tokenè¿‡æœŸï¼Ÿ**
> 
> ğŸ’¡ **è§£å†³æ–¹æ¡ˆ**ï¼š
> - å®æ–½è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
> - æä¾›å‹å¥½çš„é‡æ–°è®¤è¯æµç¨‹
> - ä¿å­˜ç”¨æˆ·æ“ä½œçŠ¶æ€
> - æ— ç¼çš„ç™»å½•ä½“éªŒ

> â“ **åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¦‚ä½•åŒæ­¥TokençŠ¶æ€ï¼Ÿ**
> 
> ğŸ’¡ **è§£å†³æ–¹æ¡ˆ**ï¼š
> - ä½¿ç”¨Redisç­‰åˆ†å¸ƒå¼ç¼“å­˜
> - å®æ–½äº‹ä»¶é©±åŠ¨çš„çŠ¶æ€åŒæ­¥
> - è®¾è®¡æœ€ç»ˆä¸€è‡´æ€§ç­–ç•¥
> - ä¼˜åŒ–ç½‘ç»œé€šä¿¡å¼€é”€

**æ ¸å¿ƒè®°å¿†**ï¼š
- Tokenè®¤è¯æ˜¯ç°ä»£åº”ç”¨çš„æ ‡å‡†è®¤è¯æ–¹å¼
- å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒéœ€è¦å¹³è¡¡è€ƒè™‘
- å®æ–½å®Œæ•´çš„Tokenç”Ÿå‘½å‘¨æœŸç®¡ç†
- ç›‘æ§å’Œåº”å¯¹å„ç§å®‰å…¨å¨èƒ