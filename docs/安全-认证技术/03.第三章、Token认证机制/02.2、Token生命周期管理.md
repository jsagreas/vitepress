---
title: 2ã€Tokenç”Ÿå‘½å‘¨æœŸç®¡ç†
---
## ğŸ“š ç›®å½•

1. [Tokenç”Ÿå‘½å‘¨æœŸæ¦‚è¿°](#1-Tokenç”Ÿå‘½å‘¨æœŸæ¦‚è¿°)
2. [Tokenå­˜å‚¨ç­–ç•¥è¯¦è§£](#2-Tokenå­˜å‚¨ç­–ç•¥è¯¦è§£)
3. [Tokenä¼ è¾“æ–¹å¼](#3-Tokenä¼ è¾“æ–¹å¼)
4. [Tokenè¿‡æœŸæœºåˆ¶ä¸åˆ·æ–°ç­–ç•¥](#4-Tokenè¿‡æœŸæœºåˆ¶ä¸åˆ·æ–°ç­–ç•¥)
5. [Bearer Tokenä½¿ç”¨æ–¹å¼](#5-Bearer-Tokenä½¿ç”¨æ–¹å¼)
6. [Access Token vs Refresh Token](#6-Access-Token-vs-Refresh-Token)
7. [Tokené»‘åå•ä¸ç»­ç­¾æœºåˆ¶](#7-Tokené»‘åå•ä¸ç»­ç­¾æœºåˆ¶)
8. [Tokené¢å‘æ—¶æœº](#8-Tokené¢å‘æ—¶æœº)
9. [å®‰å…¨è€ƒè™‘ä¸æœ€ä½³å®è·µ](#9-å®‰å…¨è€ƒè™‘ä¸æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ Tokenç”Ÿå‘½å‘¨æœŸæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Tokenç”Ÿå‘½å‘¨æœŸ


**ç®€å•ç†è§£**ï¼šTokenå°±åƒä¸€å¼ ä¸´æ—¶é€šè¡Œè¯ï¼Œæœ‰å›ºå®šçš„ä½¿ç”¨æ—¶é—´å’Œè§„åˆ™

```
Tokenç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼š
é¢å‘ â†’ ä½¿ç”¨ â†’ éªŒè¯ â†’ ç»­ç­¾/åˆ·æ–° â†’ é”€æ¯

å°±åƒç”µå½±ç¥¨ï¼š
ä¹°ç¥¨(é¢å‘) â†’ è¿›åœº(ä½¿ç”¨) â†’ æ£€ç¥¨(éªŒè¯) â†’ ä¸­åœºä¼‘æ¯å¯ç»­ç¥¨(ç»­ç­¾) â†’ ç”µå½±ç»“æŸä½œåºŸ(é”€æ¯)
```

### 1.2 Tokenç”Ÿå‘½å‘¨æœŸçš„æ ¸å¿ƒé˜¶æ®µ


**ğŸ¯ äº”ä¸ªå…³é”®é˜¶æ®µ**ï¼š

| é˜¶æ®µ | **è¯´æ˜** | **å®é™…åœºæ™¯** |
|------|---------|-------------|
| ğŸ« **é¢å‘(Issue)** | `æœåŠ¡å™¨åˆ›å»ºå¹¶å‘æ”¾Token` | `ç”¨æˆ·ç™»å½•æˆåŠŸåè·å¾—Token` |
| ğŸ’¼ **å­˜å‚¨(Store)** | `å®¢æˆ·ç«¯ä¿å­˜Token` | `å­˜åœ¨æµè§ˆå™¨ã€æ‰‹æœºAppä¸­` |
| ğŸ” **ä½¿ç”¨(Use)** | `è¯·æ±‚æ—¶æºå¸¦Token` | `è®¿é—®éœ€è¦æƒé™çš„APIæ¥å£` |
| âœ… **éªŒè¯(Verify)** | `æœåŠ¡å™¨æ£€æŸ¥Tokenæœ‰æ•ˆæ€§` | `ç¡®è®¤ç”¨æˆ·èº«ä»½å’Œæƒé™` |
| ğŸ”„ **åˆ·æ–°/é”€æ¯** | `æ›´æ–°æˆ–åˆ é™¤Token` | `è‡ªåŠ¨ç»­æœŸæˆ–ä¸»åŠ¨é€€å‡ºç™»å½•` |

### 1.3 ä¸ºä»€ä¹ˆè¦ç®¡ç†Tokenç”Ÿå‘½å‘¨æœŸ


**ğŸ¯ æ ¸å¿ƒç›®çš„**ï¼š

```
å®‰å…¨æ€§è€ƒè™‘ï¼š
- é˜²æ­¢Tokenè¢«æ°¸ä¹…æ»¥ç”¨
- åŠæ—¶å‘ç°å¼‚å¸¸ä½¿ç”¨
- æ§åˆ¶è®¿é—®æƒé™èŒƒå›´

ç”¨æˆ·ä½“éªŒï¼š
- è‡ªåŠ¨ç»­ç­¾ï¼Œæ— æ„Ÿåˆ·æ–°
- é¿å…é¢‘ç¹é‡æ–°ç™»å½•
- ä¿æŒç™»å½•çŠ¶æ€

ç³»ç»Ÿæ€§èƒ½ï¼š
- æ¸…ç†è¿‡æœŸToken
- å‡å°‘æ— æ•ˆéªŒè¯
- ä¼˜åŒ–å­˜å‚¨ç©ºé—´
```

---

## 2. ğŸ’¾ Tokenå­˜å‚¨ç­–ç•¥è¯¦è§£


### 2.1 ä¸‰ç§ä¸»è¦å­˜å‚¨æ–¹å¼


#### ğŸ“‹ å†…å­˜å­˜å‚¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯å†…å­˜å­˜å‚¨**ï¼š
Tokenä¿å­˜åœ¨ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜ä¸­ï¼Œç¨‹åºå…³é—­å°±ä¸¢å¤±

```javascript
// å†…å­˜å­˜å‚¨ç¤ºä¾‹
let authToken = null;

// ç™»å½•åå­˜å‚¨
function login(username, password) {
    // ç™»å½•æˆåŠŸå
    authToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
}

// ä½¿ç”¨Token
function makeApiCall() {
    if (authToken) {
        // å‘é€è¯·æ±‚æ—¶ä½¿ç”¨
        fetch('/api/data', {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });
    }
}
```

**âœ… ä¼˜ç‚¹**ï¼š
- æœ€å®‰å…¨ï¼Œä¸ä¼šè¢«å…¶ä»–ç¨‹åºè¯»å–
- é¡µé¢å…³é—­è‡ªåŠ¨æ¸…é™¤
- ä¸å ç”¨ç£ç›˜ç©ºé—´

**âŒ ç¼ºç‚¹**ï¼š
- åˆ·æ–°é¡µé¢å°±ä¸¢å¤±ï¼Œç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•
- ä¸é€‚åˆéœ€è¦æŒä¹…ç™»å½•çš„åœºæ™¯

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼šé«˜å®‰å…¨è¦æ±‚çš„æ“ä½œï¼Œå¦‚ç½‘é“¶è½¬è´¦

#### ğŸª Cookieå­˜å‚¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯Cookieå­˜å‚¨**ï¼š
Tokenä¿å­˜åœ¨æµè§ˆå™¨Cookieä¸­ï¼Œæ¯æ¬¡è¯·æ±‚è‡ªåŠ¨æºå¸¦

```javascript
// Cookieå­˜å‚¨ç¤ºä¾‹
function setTokenToCookie(token) {
    // è®¾ç½®Cookieï¼Œ7å¤©è¿‡æœŸ
    document.cookie = `auth_token=${token}; expires=${new Date(Date.now() + 7*24*60*60*1000).toUTCString()}; path=/; secure; httpOnly`;
}

// Cookieä¼šè‡ªåŠ¨åœ¨è¯·æ±‚ä¸­æºå¸¦ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ 
```

**âœ… ä¼˜ç‚¹**ï¼š
- è‡ªåŠ¨æºå¸¦ï¼Œå‰ç«¯æ— éœ€æ‰‹åŠ¨å¤„ç†
- å¯è®¾ç½®è¿‡æœŸæ—¶é—´
- æ”¯æŒHttpOnlyå¢å¼ºå®‰å…¨æ€§

**âŒ ç¼ºç‚¹**ï¼š
- æœ‰å¤§å°é™åˆ¶ï¼ˆ4KBï¼‰
- å®¹æ˜“å—åˆ°CSRFæ”»å‡»
- ä¸é€‚åˆè·¨åŸŸè¯·æ±‚

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼šä¼ ç»ŸWebåº”ç”¨ï¼ŒåŒåŸŸåä¸‹çš„ç³»ç»Ÿ

#### ğŸ’½ æœ¬åœ°å­˜å‚¨


**ğŸ”¸ localStorage å’Œ sessionStorage**ï¼š

```javascript
// localStorage - æŒä¹…å­˜å‚¨
localStorage.setItem('auth_token', token);
const token = localStorage.getItem('auth_token');

// sessionStorage - ä¼šè¯å­˜å‚¨  
sessionStorage.setItem('auth_token', token);
const sessionToken = sessionStorage.getItem('auth_token');
```

**localStorageç‰¹ç‚¹**ï¼š
- âœ… æŒä¹…ä¿å­˜ï¼Œå…³é—­æµè§ˆå™¨ä¸ä¸¢å¤±
- âœ… å­˜å‚¨ç©ºé—´å¤§ï¼ˆ5-10MBï¼‰
- âŒ å®¹æ˜“è¢«XSSæ”»å‡»è¯»å–

**sessionStorageç‰¹ç‚¹**ï¼š
- âœ… ä¼šè¯çº§ä¿å­˜ï¼Œå…³é—­æ ‡ç­¾é¡µå°±æ¸…é™¤
- âœ… ç›¸å¯¹å®‰å…¨ä¸€äº›
- âŒ æ–°å¼€æ ‡ç­¾é¡µæ— æ³•å…±äº«

### 2.2 å­˜å‚¨ç­–ç•¥å¯¹æ¯”


| å­˜å‚¨æ–¹å¼ | **å®‰å…¨æ€§** | **æŒä¹…æ€§** | **ä½¿ç”¨ä¾¿åˆ©** | **é€‚ç”¨åœºæ™¯** |
|---------|-----------|-----------|-------------|-------------|
| **å†…å­˜å­˜å‚¨** | `ğŸŸ¢ æœ€é«˜` | `ğŸ”´ æœ€ä½` | `ğŸŸ¡ ä¸€èˆ¬` | `é«˜å®‰å…¨è¦æ±‚` |
| **Cookie** | `ğŸŸ¡ ä¸­ç­‰` | `ğŸŸ¢ é«˜` | `ğŸŸ¢ æœ€ä¾¿åˆ©` | `ä¼ ç»ŸWebåº”ç”¨` |
| **localStorage** | `ğŸ”´ è¾ƒä½` | `ğŸŸ¢ æœ€é«˜` | `ğŸŸ¢ ä¾¿åˆ©` | `å•é¡µåº”ç”¨SPA` |
| **sessionStorage** | `ğŸŸ¡ ä¸­ç­‰` | `ğŸŸ¡ ä¸­ç­‰` | `ğŸŸ¢ ä¾¿åˆ©` | `ä¼šè¯çº§åº”ç”¨` |

---

## 3. ğŸ“¡ Tokenä¼ è¾“æ–¹å¼


### 3.1 HTTP Headerä¼ è¾“ï¼ˆæ¨èæ–¹å¼ï¼‰


**ğŸ”¸ Authorization Header**ï¼š

```javascript
// æ ‡å‡†Bearer Tokenæ–¹å¼
fetch('/api/user', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...',
        'Content-Type': 'application/json'
    }
});

// è‡ªå®šä¹‰Headeræ–¹å¼
fetch('/api/data', {
    headers: {
        'X-Auth-Token': 'your-token-here',
        'X-API-Key': 'your-api-key'
    }
});
```

**âœ… ä¼˜ç‚¹**ï¼š
- æ ‡å‡†åŒ–ï¼Œå„ç§æ¡†æ¶éƒ½æ”¯æŒ
- ä¸ä¼šåœ¨URLä¸­æš´éœ²
- çµæ´»ï¼Œå¯ä»¥æºå¸¦å¤šä¸ªToken

**ğŸ¯ æœ€ä½³å®è·µ**ï¼š99%çš„ç°ä»£åº”ç”¨éƒ½ç”¨è¿™ç§æ–¹å¼

### 3.2 URLå‚æ•°ä¼ è¾“ï¼ˆä¸æ¨èï¼‰


```javascript
// URLå‚æ•°æ–¹å¼ - ä¸å®‰å…¨
const apiUrl = `https://api.example.com/data?token=${authToken}&user_id=123`;
fetch(apiUrl);
```

**âŒ é—®é¢˜**ï¼š
- URLä¼šè¢«è®°å½•åœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­
- å®¹æ˜“åœ¨æµè§ˆå™¨å†å²ä¸­æ³„éœ²
- URLé•¿åº¦æœ‰é™åˆ¶

**ğŸ”’ å®‰å…¨é£é™©**ï¼šTokenæš´éœ²åœ¨URLä¸­éå¸¸å±é™©ï¼

### 3.3 POST Bodyä¼ è¾“


```javascript
// POSTè¯·æ±‚ä½“ä¸­æºå¸¦
fetch('/api/login', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        token: authToken,
        data: { /* å…¶ä»–æ•°æ® */ }
    })
});
```

**ğŸ¯ ä½¿ç”¨åœºæ™¯**ï¼š
- ç‰¹æ®Šçš„è®¤è¯æ¥å£
- éœ€è¦åœ¨è¯·æ±‚ä½“ä¸­éªŒè¯èº«ä»½çš„åœºæ™¯

---

## 4. â° Tokenè¿‡æœŸæœºåˆ¶ä¸åˆ·æ–°ç­–ç•¥


### 4.1 Tokenè¿‡æœŸçš„åŸå› 


**ğŸ”¸ ä¸ºä»€ä¹ˆTokenè¦è¿‡æœŸ**ï¼š

```
å®‰å…¨è€ƒè™‘ï¼š
- å‡å°‘è¢«ç›—ç”¨çš„æ—¶é—´çª—å£
- å¼ºåˆ¶é‡æ–°éªŒè¯ç”¨æˆ·èº«ä»½
- é˜²æ­¢é•¿æœŸæ»¥ç”¨

ç”¨æˆ·ä½“éªŒï¼š
- å¹³è¡¡å®‰å…¨æ€§å’Œä¾¿åˆ©æ€§
- é¿å…æ— é™æœŸå ç”¨ç³»ç»Ÿèµ„æº
```

### 4.2 è¿‡æœŸæ—¶é—´è®¾ç½®ç­–ç•¥


**ğŸ“Š å¸¸è§è¿‡æœŸæ—¶é—´è®¾ç½®**ï¼š

| Tokenç±»å‹ | **è¿‡æœŸæ—¶é—´** | **ä½¿ç”¨åœºæ™¯** | **å®‰å…¨çº§åˆ«** |
|----------|-------------|-------------|-------------|
| **Access Token** | `15åˆ†é’Ÿ-2å°æ—¶` | `APIè®¿é—®` | `ğŸ”´ é«˜å®‰å…¨` |
| **Refresh Token** | `7å¤©-30å¤©` | `åˆ·æ–°Access Token` | `ğŸŸ¡ ä¸­ç­‰` |
| **Remember Token** | `30å¤©-1å¹´` | `è®°ä½ç™»å½•çŠ¶æ€` | `ğŸŸ¡ ä¸­ç­‰` |
| **Session Token** | `ä¼šè¯ç»“æŸ` | `å•æ¬¡ä¼šè¯` | `ğŸŸ¢ ä¸€èˆ¬` |

### 4.3 Tokenåˆ·æ–°ç­–ç•¥


#### ğŸ”„ è‡ªåŠ¨åˆ·æ–°ç­–ç•¥


```javascript
// è‡ªåŠ¨åˆ·æ–°Tokençš„å®ç°
class TokenManager {
    constructor() {
        this.accessToken = null;
        this.refreshToken = null;
        this.refreshTimer = null;
    }
    
    // è®¾ç½®Tokenå¹¶å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
    setTokens(accessToken, refreshToken, expiresIn) {
        this.accessToken = accessToken;
        this.refreshToken = refreshToken;
        
        // åœ¨Tokenè¿‡æœŸå‰5åˆ†é’Ÿåˆ·æ–°
        const refreshTime = (expiresIn - 300) * 1000;
        this.refreshTimer = setTimeout(() => {
            this.refreshAccessToken();
        }, refreshTime);
    }
    
    // åˆ·æ–°Access Token
    async refreshAccessToken() {
        try {
            const response = await fetch('/auth/refresh', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    refresh_token: this.refreshToken
                })
            });
            
            if (response.ok) {
                const data = await response.json();
                this.setTokens(data.access_token, data.refresh_token, data.expires_in);
            }
        } catch (error) {
            console.error('åˆ·æ–°Tokenå¤±è´¥:', error);
            // è·³è½¬åˆ°ç™»å½•é¡µ
            window.location.href = '/login';
        }
    }
}
```

#### ğŸ¯ æ‰‹åŠ¨åˆ·æ–°ç­–ç•¥


```javascript
// è¯·æ±‚æ‹¦æˆªå™¨ - æ£€æµ‹Tokenè¿‡æœŸ
axios.interceptors.response.use(
    response => response,
    async error => {
        if (error.response?.status === 401) {
            // Tokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°
            const newToken = await refreshToken();
            if (newToken) {
                // é‡æ–°å‘é€åŸè¯·æ±‚
                error.config.headers.Authorization = `Bearer ${newToken}`;
                return axios.request(error.config);
            } else {
                // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•
                window.location.href = '/login';
            }
        }
        return Promise.reject(error);
    }
);
```

---

## 5. ğŸ« Bearer Tokenä½¿ç”¨æ–¹å¼


### 5.1 ä»€ä¹ˆæ˜¯Bearer Token


**ğŸ”¸ Bearer Tokenå«ä¹‰**ï¼š
`Bearer`æ˜¯"æŒæœ‰è€…"çš„æ„æ€ï¼ŒBearer Tokenå°±æ˜¯"æŒæœ‰è€…ä»¤ç‰Œ"

```
Bearer Tokençš„å«ä¹‰ï¼š
"è°æŒæœ‰è¿™ä¸ªTokenï¼Œè°å°±æ‹¥æœ‰ç›¸åº”çš„æƒé™"

ç±»æ¯”ï¼š
Bearer Token = ç”µå½±ç¥¨
è°æ‹¿ç€ç¥¨ï¼Œè°å°±èƒ½è¿›ç”µå½±é™¢ï¼Œä¸ç®¡è¿™ä¸ªäººæ˜¯è°
```

### 5.2 Bearer Tokenæ ‡å‡†æ ¼å¼


```http
Authorization: Bearer <token>

å®ä¾‹ï¼š
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

### 5.3 Bearer Tokenä½¿ç”¨ç¤ºä¾‹


```javascript
// å‰ç«¯å‘é€è¯·æ±‚
const token = localStorage.getItem('access_token');

fetch('/api/profile', {
    method: 'GET',
    headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
    }
})
.then(response => {
    if (response.status === 401) {
        console.log('Tokenæ— æ•ˆæˆ–è¿‡æœŸ');
        // è·³è½¬åˆ°ç™»å½•é¡µ
    }
    return response.json();
});
```

```python
# åç«¯éªŒè¯Bearer Token (Python Flaskç¤ºä¾‹)
from flask import request, jsonify
import jwt

@app.route('/api/profile')
def get_profile():
    # è·å–Authorization header
    auth_header = request.headers.get('Authorization')
    
    if not auth_header or not auth_header.startswith('Bearer '):
        return jsonify({'error': 'ç¼ºå°‘Bearer Token'}), 401
    
    # æå–Token
    token = auth_header.split(' ')[1]
    
    try:
        # éªŒè¯Token
        payload = jwt.decode(token, SECRET_KEY, algorithms=['HS256'])
        user_id = payload['user_id']
        
        # è¿”å›ç”¨æˆ·ä¿¡æ¯
        return jsonify({'user_id': user_id, 'profile': '...'})
    
    except jwt.ExpiredSignatureError:
        return jsonify({'error': 'Tokenå·²è¿‡æœŸ'}), 401
    except jwt.InvalidTokenError:
        return jsonify({'error': 'Tokenæ— æ•ˆ'}), 401
```

---

## 6. ğŸ”„ Access Token vs Refresh Token


### 6.1 åŒTokenæœºåˆ¶çš„åŸç†


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§Token**ï¼š

```
é—®é¢˜åœºæ™¯ï¼š
å¦‚æœåªæœ‰ä¸€ä¸ªTokenï¼š
- è¿‡æœŸæ—¶é—´çŸ­ â†’ ç”¨æˆ·é¢‘ç¹ç™»å½•ï¼Œä½“éªŒå·®
- è¿‡æœŸæ—¶é—´é•¿ â†’ è¢«ç›—ç”¨é£é™©å¤§ï¼Œå®‰å…¨æ€§å·®

åŒTokenè§£å†³æ–¹æ¡ˆï¼š
Access Token(çŸ­æœŸ) + Refresh Token(é•¿æœŸ)
æ—¢ä¿è¯äº†å®‰å…¨æ€§ï¼Œåˆæä¾›äº†è‰¯å¥½ä½“éªŒ
```

### 6.2 ä¸¤ç§Tokençš„åŒºåˆ«


| ç‰¹æ€§ | **Access Token** | **Refresh Token** |
|------|------------------|-------------------|
| **ç”¨é€”** | `è®¿é—®å—ä¿æŠ¤èµ„æº` | `åˆ·æ–°Access Token` |
| **è¿‡æœŸæ—¶é—´** | `çŸ­æœŸ(15åˆ†é’Ÿ-2å°æ—¶)` | `é•¿æœŸ(7å¤©-30å¤©)` |
| **ä½¿ç”¨é¢‘ç‡** | `æ¯æ¬¡APIè¯·æ±‚` | `ä»…åœ¨åˆ·æ–°æ—¶ä½¿ç”¨` |
| **å­˜å‚¨ä½ç½®** | `å†…å­˜/sessionStorage` | `httpOnly Cookie` |
| **å®‰å…¨çº§åˆ«** | `ä¸­ç­‰` | `é«˜` |

### 6.3 åŒTokenå·¥ä½œæµç¨‹


```
ç”¨æˆ·ç™»å½•æµç¨‹ï¼š
ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç 
      â†“
æœåŠ¡å™¨éªŒè¯æˆåŠŸ
      â†“
è¿”å›Access Token(çŸ­æœŸ) + Refresh Token(é•¿æœŸ)
      â†“
å®¢æˆ·ç«¯å­˜å‚¨ä¸¤ä¸ªToken

APIè®¿é—®æµç¨‹ï¼š
å®¢æˆ·ç«¯ç”¨Access Tokenè®¿é—®API
      â†“
Access Tokenè¿‡æœŸï¼Ÿ
      â†“
æ˜¯ï¼šç”¨Refresh Tokenè·å–æ–°çš„Access Token
      â†“
ç»§ç»­APIè®¿é—®

Tokenåˆ·æ–°æµç¨‹ï¼š
å®¢æˆ·ç«¯å‘ç°Access Tokenè¿‡æœŸ
      â†“
æºå¸¦Refresh Tokenè¯·æ±‚/refreshç«¯ç‚¹
      â†“
æœåŠ¡å™¨éªŒè¯Refresh Token
      â†“
è¿”å›æ–°çš„Access Token(å¯é€‰ï¼šæ–°çš„Refresh Token)
```

### 6.4 åŒTokenå®ç°ç¤ºä¾‹


```javascript
// åŒTokenç®¡ç†ç±»
class AuthManager {
    constructor() {
        this.accessToken = null;
        this.refreshToken = null;
    }
    
    // ç™»å½•è·å–Token
    async login(username, password) {
        const response = await fetch('/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        
        if (response.ok) {
            const data = await response.json();
            this.accessToken = data.access_token;
            this.refreshToken = data.refresh_token;
            
            // Access Tokenå­˜å†…å­˜ï¼ŒRefresh Tokenå­˜Cookie
            this.storeRefreshToken(data.refresh_token);
        }
    }
    
    // åˆ·æ–°Access Token
    async refreshAccessToken() {
        const response = await fetch('/auth/refresh', {
            method: 'POST',
            credentials: 'include', // è‡ªåŠ¨æºå¸¦Cookieä¸­çš„Refresh Token
        });
        
        if (response.ok) {
            const data = await response.json();
            this.accessToken = data.access_token;
            return data.access_token;
        }
        return null;
    }
    
    // å®‰å…¨åœ°å­˜å‚¨Refresh Token
    storeRefreshToken(refreshToken) {
        // è®¾ç½®httpOnly Cookieï¼Œå‰ç«¯JSæ— æ³•è¯»å–ï¼Œæ›´å®‰å…¨
        document.cookie = `refresh_token=${refreshToken}; httpOnly; secure; path=/`;
    }
    
    // å¸¦è‡ªåŠ¨åˆ·æ–°çš„APIè¯·æ±‚
    async apiRequest(url, options = {}) {
        // å…ˆç”¨å½“å‰Access Tokenå°è¯•
        options.headers = {
            ...options.headers,
            'Authorization': `Bearer ${this.accessToken}`
        };
        
        let response = await fetch(url, options);
        
        // å¦‚æœTokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°
        if (response.status === 401) {
            const newToken = await this.refreshAccessToken();
            if (newToken) {
                options.headers.Authorization = `Bearer ${newToken}`;
                response = await fetch(url, options);
            }
        }
        
        return response;
    }
}
```

---

## 7. ğŸš« Tokené»‘åå•ä¸ç»­ç­¾æœºåˆ¶


### 7.1 Tokené»‘åå•æœºåˆ¶


**ğŸ”¸ ä»€ä¹ˆæ˜¯Tokené»‘åå•**ï¼š
æŠŠå·²ç»ä½œåºŸçš„Tokenè®°å½•ä¸‹æ¥ï¼Œå³ä½¿Tokenè¿˜æ²¡è¿‡æœŸä¹Ÿæ‹’ç»ä½¿ç”¨

```
åº”ç”¨åœºæ™¯ï¼š
- ç”¨æˆ·ä¸»åŠ¨ç™»å‡º
- å‘ç°Tokenè¢«ç›—ç”¨
- ç”¨æˆ·ä¿®æ”¹å¯†ç åè®©æ‰€æœ‰Tokenå¤±æ•ˆ
- ç®¡ç†å‘˜å¼ºåˆ¶ä¸‹çº¿ç”¨æˆ·
```

### 7.2 é»‘åå•å®ç°æ–¹å¼


#### ğŸ“‹ Redisé»‘åå•å®ç°


```python
# Python + Rediså®ç°Tokené»‘åå•
import redis
import jwt
from datetime import datetime, timedelta

class TokenBlacklist:
    def __init__(self):
        self.redis_client = redis.Redis(host='localhost', port=6379, db=0)
    
    def add_to_blacklist(self, token):
        """å°†TokenåŠ å…¥é»‘åå•"""
        try:
            # è§£æTokenè·å–è¿‡æœŸæ—¶é—´
            payload = jwt.decode(token, options={"verify_signature": False})
            exp_timestamp = payload.get('exp')
            
            if exp_timestamp:
                # è®¡ç®—Tokenå‰©ä½™æœ‰æ•ˆæ—¶é—´
                remaining_time = exp_timestamp - int(datetime.utcnow().timestamp())
                
                if remaining_time > 0:
                    # åœ¨Redisä¸­å­˜å‚¨ï¼Œè¿‡æœŸæ—¶é—´å°±æ˜¯Tokençš„å‰©ä½™æ—¶é—´
                    self.redis_client.setex(
                        f"blacklist:{token}", 
                        remaining_time, 
                        "revoked"
                    )
        except:
            pass
    
    def is_token_blacklisted(self, token):
        """æ£€æŸ¥Tokenæ˜¯å¦åœ¨é»‘åå•ä¸­"""
        return self.redis_client.exists(f"blacklist:{token}")
```

```javascript
// å‰ç«¯ç™»å‡ºæ—¶åŠ å…¥é»‘åå•
async function logout() {
    const token = localStorage.getItem('access_token');
    
    // é€šçŸ¥æœåŠ¡å™¨å°†TokenåŠ å…¥é»‘åå•
    await fetch('/auth/logout', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        }
    });
    
    // æ¸…é™¤æœ¬åœ°å­˜å‚¨
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    
    // è·³è½¬åˆ°ç™»å½•é¡µ
    window.location.href = '/login';
}
```

### 7.3 Tokenç»­ç­¾æœºåˆ¶


**ğŸ”¸ ä»€ä¹ˆæ˜¯Tokenç»­ç­¾**ï¼š
åœ¨Tokenå³å°†è¿‡æœŸå‰ï¼Œè‡ªåŠ¨å»¶é•¿å…¶æœ‰æ•ˆæœŸ

#### ğŸ”„ æ»‘åŠ¨çª—å£ç»­ç­¾


```javascript
// æ»‘åŠ¨çª—å£ç»­ç­¾ï¼šç”¨æˆ·æ´»è·ƒæ—¶è‡ªåŠ¨ç»­ç­¾
class SlidingTokenManager {
    constructor() {
        this.accessToken = null;
        this.lastActivity = Date.now();
        this.renewalThreshold = 5 * 60 * 1000; // 5åˆ†é’Ÿ
    }
    
    // è®°å½•ç”¨æˆ·æ´»åŠ¨
    recordActivity() {
        this.lastActivity = Date.now();
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦ç»­ç­¾
        this.checkRenewal();
    }
    
    async checkRenewal() {
        if (!this.accessToken) return;
        
        try {
            // è§£æTokenè·å–è¿‡æœŸæ—¶é—´
            const payload = JSON.parse(atob(this.accessToken.split('.')[1]));
            const expiryTime = payload.exp * 1000;
            const now = Date.now();
            
            // å¦‚æœTokenåœ¨5åˆ†é’Ÿå†…è¿‡æœŸä¸”ç”¨æˆ·æœ€è¿‘æœ‰æ´»åŠ¨
            if (expiryTime - now < this.renewalThreshold && 
                now - this.lastActivity < this.renewalThreshold) {
                
                await this.renewToken();
            }
        } catch (error) {
            console.error('ç»­ç­¾æ£€æŸ¥å¤±è´¥:', error);
        }
    }
    
    async renewToken() {
        try {
            const response = await fetch('/auth/renew', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${this.accessToken}`
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                this.accessToken = data.access_token;
                console.log('Tokenå·²è‡ªåŠ¨ç»­ç­¾');
            }
        } catch (error) {
            console.error('Tokenç»­ç­¾å¤±è´¥:', error);
        }
    }
}

// ç›‘å¬ç”¨æˆ·æ´»åŠ¨
const tokenManager = new SlidingTokenManager();

// ç›‘å¬é¼ æ ‡ç§»åŠ¨ã€é”®ç›˜è¾“å…¥ç­‰æ´»åŠ¨
document.addEventListener('mousemove', () => tokenManager.recordActivity());
document.addEventListener('keypress', () => tokenManager.recordActivity());
document.addEventListener('click', () => tokenManager.recordActivity());
```

---

## 8. ğŸ• Tokené¢å‘æ—¶æœº


### 8.1 ç™»å½•æˆåŠŸæ—¶é¢å‘


**ğŸ”¸ æœ€å¸¸è§çš„åœºæ™¯**ï¼šç”¨æˆ·è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå¯†ç å

```javascript
// ç™»å½•æˆåŠŸé¢å‘Token
app.post('/auth/login', async (req, res) => {
    const { username, password } = req.body;
    
    // éªŒè¯ç”¨æˆ·åå¯†ç 
    const user = await validateUser(username, password);
    
    if (user) {
        // é¢å‘Access Token
        const accessToken = jwt.sign(
            { 
                user_id: user.id, 
                username: user.username,
                role: user.role 
            },
            ACCESS_TOKEN_SECRET,
            { expiresIn: '1h' }
        );
        
        // é¢å‘Refresh Token
        const refreshToken = jwt.sign(
            { user_id: user.id },
            REFRESH_TOKEN_SECRET,
            { expiresIn: '7d' }
        );
        
        res.json({
            access_token: accessToken,
            refresh_token: refreshToken,
            expires_in: 3600 // 1å°æ—¶
        });
    } else {
        res.status(401).json({ error: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯' });
    }
});
```

### 8.2 åˆ·æ–°Tokenæ—¶é¢å‘


**ğŸ”¸ ç”¨Refresh Tokenæ¢å–æ–°çš„Access Token**ï¼š

```javascript
app.post('/auth/refresh', async (req, res) => {
    const { refresh_token } = req.body;
    
    try {
        // éªŒè¯Refresh Token
        const payload = jwt.verify(refresh_token, REFRESH_TOKEN_SECRET);
        
        // æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•ä¸­
        if (await isTokenBlacklisted(refresh_token)) {
            return res.status(401).json({ error: 'Refresh Tokenå·²å¤±æ•ˆ' });
        }
        
        // é¢å‘æ–°çš„Access Token
        const newAccessToken = jwt.sign(
            { 
                user_id: payload.user_id,
                // ä»æ•°æ®åº“è·å–æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯
                ...await getUserById(payload.user_id)
            },
            ACCESS_TOKEN_SECRET,
            { expiresIn: '1h' }
        );
        
        // å¯é€‰ï¼šä¹Ÿé¢å‘æ–°çš„Refresh Tokenï¼ˆè½®æ¢æœºåˆ¶ï¼‰
        const newRefreshToken = jwt.sign(
            { user_id: payload.user_id },
            REFRESH_TOKEN_SECRET,
            { expiresIn: '7d' }
        );
        
        // å°†æ—§çš„Refresh TokenåŠ å…¥é»‘åå•
        await addToBlacklist(refresh_token);
        
        res.json({
            access_token: newAccessToken,
            refresh_token: newRefreshToken,
            expires_in: 3600
        });
        
    } catch (error) {
        res.status(401).json({ error: 'Refresh Tokenæ— æ•ˆ' });
    }
});
```

### 8.3 ç¬¬ä¸‰æ–¹æˆæƒæ—¶é¢å‘ï¼ˆOAuth2åœºæ™¯ï¼‰


**ğŸ”¸ OAuth2æˆæƒæµç¨‹ä¸­çš„Tokené¢å‘**ï¼š

```
OAuth2 æˆæƒç æ¨¡å¼æµç¨‹ï¼š

1. ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯åº”ç”¨
   â†“
2. é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨ç™»å½•
   â†“  
3. ç”¨æˆ·æˆæƒåŒæ„
   â†“
4. æˆæƒæœåŠ¡å™¨è¿”å›æˆæƒç 
   â†“
5. å®¢æˆ·ç«¯ç”¨æˆæƒç æ¢å–Token â† è¿™é‡Œé¢å‘Token
   â†“
6. å®¢æˆ·ç«¯ç”¨Tokenè®¿é—®èµ„æºæœåŠ¡å™¨
```

```javascript
// OAuth2 Tokené¢å‘ç«¯ç‚¹
app.post('/oauth2/token', async (req, res) => {
    const { 
        grant_type, 
        code, 
        client_id, 
        client_secret,
        redirect_uri 
    } = req.body;
    
    if (grant_type === 'authorization_code') {
        try {
            // éªŒè¯æˆæƒç 
            const authCode = await validateAuthorizationCode(code, client_id, redirect_uri);
            
            if (authCode) {
                // é¢å‘Access Token
                const accessToken = jwt.sign(
                    {
                        user_id: authCode.user_id,
                        client_id: client_id,
                        scope: authCode.scope
                    },
                    ACCESS_TOKEN_SECRET,
                    { expiresIn: '1h' }
                );
                
                // é¢å‘Refresh Token
                const refreshToken = jwt.sign(
                    {
                        user_id: authCode.user_id,
                        client_id: client_id
                    },
                    REFRESH_TOKEN_SECRET,
                    { expiresIn: '30d' }
                );
                
                // åˆ é™¤å·²ä½¿ç”¨çš„æˆæƒç 
                await deleteAuthorizationCode(code);
                
                res.json({
                    access_token: accessToken,
                    token_type: 'Bearer',
                    expires_in: 3600,
                    refresh_token: refreshToken,
                    scope: authCode.scope
                });
            }
        } catch (error) {
            res.status(400).json({ 
                error: 'invalid_grant',
                error_description: 'æˆæƒç æ— æ•ˆæˆ–å·²è¿‡æœŸ'
            });
        }
    }
});
```

### 8.4 å…¶ä»–Tokené¢å‘åœºæ™¯


**ğŸ“‹ ç‰¹æ®Šåœºæ™¯ä¸‹çš„Tokené¢å‘**ï¼š

```javascript
// 1. ç¤¾äº¤ç™»å½•æˆåŠŸåé¢å‘
app.post('/auth/social-login', async (req, res) => {
    const { provider, social_token } = req.body;
    
    // éªŒè¯ç¬¬ä¸‰æ–¹Tokenï¼ˆå¦‚å¾®ä¿¡ã€QQç­‰ï¼‰
    const userInfo = await validateSocialToken(provider, social_token);
    
    if (userInfo) {
        // åˆ›å»ºæˆ–æ›´æ–°æœ¬åœ°ç”¨æˆ·
        const localUser = await createOrUpdateUser(userInfo);
        
        // é¢å‘ç³»ç»ŸToken
        const token = generateToken(localUser);
        res.json({ token });
    }
});

// 2. ä¸´æ—¶è®¿é—®Tokenï¼ˆå¦‚é‡ç½®å¯†ç ï¼‰
app.post('/auth/reset-password-token', async (req, res) => {
    const { email } = req.body;
    
    const user = await findUserByEmail(email);
    if (user) {
        // é¢å‘çŸ­æœŸé‡ç½®å¯†ç Token
        const resetToken = jwt.sign(
            { 
                user_id: user.id, 
                purpose: 'password_reset' 
            },
            RESET_TOKEN_SECRET,
            { expiresIn: '30m' } // 30åˆ†é’Ÿ
        );
        
        // å‘é€é‚®ä»¶...
        await sendResetEmail(user.email, resetToken);
        
        res.json({ message: 'é‡ç½®é‚®ä»¶å·²å‘é€' });
    }
});
```

---

## 9. ğŸ”’ å®‰å…¨è€ƒè™‘ä¸æœ€ä½³å®è·µ


### 9.1 Tokenå­˜å‚¨å®‰å…¨


**ğŸ›¡ï¸ å­˜å‚¨ä½ç½®å®‰å…¨åŸåˆ™**ï¼š

| å­˜å‚¨ä½ç½® | **å®‰å…¨çº§åˆ«** | **é€‚ç”¨Token** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|-------------|
| **å†…å­˜** | `ğŸŸ¢ æœ€å®‰å…¨` | `Access Token` | `é¡µé¢åˆ·æ–°ä¼šä¸¢å¤±` |
| **httpOnly Cookie** | `ğŸŸ¡ è¾ƒå®‰å…¨` | `Refresh Token` | `é˜²æ­¢XSSè¯»å–` |
| **localStorage** | `ğŸ”´ é£é™©è¾ƒé«˜` | `éæ•æ„Ÿæ•°æ®` | `å®¹æ˜“è¢«XSSæ”»å‡»` |
| **sessionStorage** | `ğŸŸ¡ ä¸­ç­‰` | `ä¼šè¯çº§æ•°æ®` | `ç›¸å¯¹localStorageå®‰å…¨` |

### 9.2 ä¼ è¾“å®‰å…¨


```javascript
// âœ… å®‰å…¨çš„Tokenä¼ è¾“
const secureRequest = {
    // 1. ä½¿ç”¨HTTPS
    url: 'https://api.example.com/data',
    
    // 2. æ­£ç¡®çš„Headeræ ¼å¼
    headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
    },
    
    // 3. ä¸åœ¨URLä¸­æš´éœ²Token
    method: 'POST',
    body: JSON.stringify({
        // æ•°æ®å†…å®¹
    })
};

// âŒ ä¸å®‰å…¨çš„ä¼ è¾“æ–¹å¼
const unsecureRequest = {
    // 1. HTTPä¸å®‰å…¨
    url: `http://api.example.com/data?token=${accessToken}`, // Tokenæš´éœ²åœ¨URLä¸­
    method: 'GET'
};
```

### 9.3 Tokenæ³„éœ²é˜²æŠ¤


**ğŸš¨ é˜²æ­¢Tokenæ³„éœ²çš„æªæ–½**ï¼š

```javascript
// 1. Tokenæ··æ·†/åŠ å¯†å­˜å‚¨
class SecureTokenManager {
    constructor() {
        this.cryptoKey = this.generateCryptoKey();
    }
    
    // åŠ å¯†å­˜å‚¨Token
    storeToken(token) {
        const encryptedToken = this.encrypt(token);
        sessionStorage.setItem('auth_data', encryptedToken);
    }
    
    // è§£å¯†è¯»å–Token
    getToken() {
        const encryptedToken = sessionStorage.getItem('auth_data');
        return encryptedToken ? this.decrypt(encryptedToken) : null;
    }
    
    // ç®€å•çš„å¼‚æˆ–åŠ å¯†ï¼ˆå®é™…é¡¹ç›®å»ºè®®ä½¿ç”¨ä¸“ä¸šåŠ å¯†åº“ï¼‰
    encrypt(text) {
        return btoa(text.split('').map((char, i) => 
            String.fromCharCode(char.charCodeAt(0) ^ this.cryptoKey.charCodeAt(i % this.cryptoKey.length))
        ).join(''));
    }
    
    decrypt(encryptedText) {
        return atob(encryptedText).split('').map((char, i) => 
            String.fromCharCode(char.charCodeAt(0) ^ this.cryptoKey.charCodeAt(i % this.cryptoKey.length))
        ).join('');
    }
    
    generateCryptoKey() {
        // åŸºäºç”¨æˆ·è®¾å¤‡ä¿¡æ¯ç”Ÿæˆå¯†é’¥
        return btoa(navigator.userAgent + Date.now()).slice(0, 32);
    }
}
```

### 9.4 CSRFé˜²æŠ¤


```javascript
// CSRF Tokenä¸Authentication Tokenç»“åˆä½¿ç”¨
class CSRFProtection {
    constructor() {
        this.csrfToken = null;
        this.init();
    }
    
    async init() {
        // ä»æœåŠ¡å™¨è·å–CSRF Token
        const response = await fetch('/api/csrf-token', {
            credentials: 'include'
        });
        const data = await response.json();
        this.csrfToken = data.csrf_token;
    }
    
    // å®‰å…¨çš„APIè¯·æ±‚
    async secureRequest(url, options = {}) {
        const authToken = this.getAuthToken();
        
        return fetch(url, {
            ...options,
            headers: {
                ...options.headers,
                'Authorization': `Bearer ${authToken}`,
                'X-CSRF-Token': this.csrfToken,
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
    }
}
```

### 9.5 Tokenè½®æ¢æœºåˆ¶


```javascript
// Tokenè½®æ¢ï¼šå¢å¼ºå®‰å…¨æ€§
class TokenRotationManager {
    constructor() {
        this.accessToken = null;
        this.refreshToken = null;
    }
    
    async refreshTokens() {
        try {
            const response = await fetch('/auth/refresh', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    refresh_token: this.refreshToken
                })
            });
            
            if (response.ok) {
                const data = await response.json();
                
                // æ›´æ–°ä¸¤ä¸ªTokenï¼ˆè½®æ¢æœºåˆ¶ï¼‰
                this.accessToken = data.access_token;
                this.refreshToken = data.refresh_token;
                
                // æ—§çš„Refresh Tokenè‡ªåŠ¨å¤±æ•ˆ
                console.log('Tokenå·²è½®æ¢æ›´æ–°');
                
                return true;
            }
        } catch (error) {
            console.error('Tokenè½®æ¢å¤±è´¥:', error);
            this.handleTokenFailure();
        }
        return false;
    }
    
    handleTokenFailure() {
        // æ¸…é™¤æ‰€æœ‰Token
        this.accessToken = null;
        this.refreshToken = null;
        
        // é‡å®šå‘åˆ°ç™»å½•é¡µ
        window.location.href = '/login';
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Tokenç”Ÿå‘½å‘¨æœŸï¼šé¢å‘ â†’ å­˜å‚¨ â†’ ä½¿ç”¨ â†’ éªŒè¯ â†’ åˆ·æ–°/é”€æ¯
ğŸ”¸ å­˜å‚¨ç­–ç•¥ï¼šå†…å­˜(æœ€å®‰å…¨) > Cookie > sessionStorage > localStorage
ğŸ”¸ ä¼ è¾“æ–¹å¼ï¼šHTTP Headeræ˜¯æ ‡å‡†æ–¹å¼ï¼Œé¿å…URLå‚æ•°ä¼ è¾“
ğŸ”¸ åŒTokenæœºåˆ¶ï¼šAccess Token(çŸ­æœŸ) + Refresh Token(é•¿æœŸ)
ğŸ”¸ Bearer Tokenï¼šæ ‡å‡†çš„Tokenä½¿ç”¨æ ¼å¼
ğŸ”¸ å®‰å…¨é˜²æŠ¤ï¼šHTTPSä¼ è¾“ã€é˜²XSSã€é˜²CSRFã€Tokenè½®æ¢
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦Tokenç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼š
```
å®‰å…¨æ€§ï¼šé˜²æ­¢Tokenè¢«é•¿æœŸæ»¥ç”¨
ç”¨æˆ·ä½“éªŒï¼šè‡ªåŠ¨ç»­ç­¾ï¼Œå‡å°‘é‡å¤ç™»å½•
ç³»ç»Ÿæ€§èƒ½ï¼šåŠæ—¶æ¸…ç†è¿‡æœŸæ•°æ®
```

**ğŸ”¹ åŒTokenæœºåˆ¶çš„ä»·å€¼**ï¼š
```
Access Tokenï¼šçŸ­æœŸï¼Œé«˜é¢‘ä½¿ç”¨ï¼Œè¢«ç›—å½±å“å°
Refresh Tokenï¼šé•¿æœŸï¼Œä½é¢‘ä½¿ç”¨ï¼Œå®‰å…¨çº§åˆ«é«˜
å¹³è¡¡äº†å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ
```

**ğŸ”¹ å­˜å‚¨ç­–ç•¥çš„é€‰æ‹©åŸåˆ™**ï¼š
```
é«˜å®‰å…¨åœºæ™¯ï¼šå†…å­˜å­˜å‚¨
ä¸€èˆ¬Webåº”ç”¨ï¼šhttpOnly Cookie
å•é¡µåº”ç”¨ï¼šsessionStorage
æŒä¹…åŒ–éœ€æ±‚ï¼šåŠ å¯†åçš„localStorage
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ Tokenè¿‡æœŸæ—¶é—´è®¾ç½®å»ºè®®**ï¼š
```
Access Tokenï¼š15åˆ†é’Ÿ-2å°æ—¶
- ä¸€èˆ¬åº”ç”¨ï¼š30åˆ†é’Ÿ-1å°æ—¶
- é«˜å®‰å…¨åº”ç”¨ï¼š15åˆ†é’Ÿ
- ä½é£é™©åº”ç”¨ï¼š2-4å°æ—¶

Refresh Tokenï¼š7å¤©-30å¤©
- ç§»åŠ¨åº”ç”¨ï¼š30å¤©
- Webåº”ç”¨ï¼š7-14å¤©
- ä¼ä¸šåº”ç”¨ï¼š1-7å¤©
```

**ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ**ï¼š
```
å­˜å‚¨å®‰å…¨ï¼š
âœ… æ•æ„ŸTokenç”¨httpOnly Cookie
âœ… å®¢æˆ·ç«¯TokenåŠ å¯†å­˜å‚¨
âœ… å®šæœŸæ¸…ç†è¿‡æœŸToken

ä¼ è¾“å®‰å…¨ï¼š
âœ… å¼ºåˆ¶ä½¿ç”¨HTTPS
âœ… ä½¿ç”¨æ ‡å‡†Authorization Header
âœ… é¿å…URLå‚æ•°ä¼ è¾“Token

ä½¿ç”¨å®‰å…¨ï¼š
âœ… å®ç°Tokené»‘åå•æœºåˆ¶
âœ… ç›‘æ§å¼‚å¸¸Tokenä½¿ç”¨
âœ… è‡ªåŠ¨åˆ·æ–°é¿å…è¿‡æœŸ
```

**ğŸ”§ å®ç°å»ºè®®**ï¼š
```
å‰ç«¯å®ç°ï¼š
- å°è£…Tokenç®¡ç†ç±»
- å®ç°è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
- æ·»åŠ è¯·æ±‚/å“åº”æ‹¦æˆªå™¨
- å¤„ç†Tokenè¿‡æœŸåœºæ™¯

åç«¯å®ç°ï¼š
- Tokené»‘åå•æœºåˆ¶
- å¤šè®¾å¤‡ç™»å½•ç®¡ç†
- Tokenä½¿ç”¨æ—¥å¿—è®°å½•
- å¼‚å¸¸æ£€æµ‹å’Œå‘Šè­¦
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Tokenç”Ÿå‘½å‘¨æœŸç®¡ç†æ˜¯ç°ä»£è®¤è¯ç³»ç»Ÿçš„æ ¸å¿ƒ
- åŒTokenæœºåˆ¶å®Œç¾å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ  
- å­˜å‚¨å’Œä¼ è¾“å®‰å…¨æ˜¯Tokenå®‰å…¨çš„ä¸¤å¤§åŸºçŸ³
- è‡ªåŠ¨åˆ·æ–°å’Œé»‘åå•æœºåˆ¶æä¾›å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶