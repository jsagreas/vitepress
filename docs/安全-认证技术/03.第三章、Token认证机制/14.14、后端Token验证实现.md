---
title: 14ã€åç«¯TokenéªŒè¯å®ç°
---
## ğŸ“š ç›®å½•

1. [TokenéªŒè¯åŸºç¡€æ¦‚å¿µ](#1-TokenéªŒè¯åŸºç¡€æ¦‚å¿µ)
2. [ä¸­é—´ä»¶éªŒè¯æœºåˆ¶](#2-ä¸­é—´ä»¶éªŒè¯æœºåˆ¶)
3. [Tokenè§£ææµç¨‹](#3-Tokenè§£ææµç¨‹)
4. [æƒé™æ ¡éªŒé€»è¾‘](#4-æƒé™æ ¡éªŒé€»è¾‘)
5. [å¼‚å¸¸å¤„ç†æœºåˆ¶](#5-å¼‚å¸¸å¤„ç†æœºåˆ¶)
6. [æ€§èƒ½ä¼˜åŒ–æŠ€å·§](#6-æ€§èƒ½ä¼˜åŒ–æŠ€å·§)
7. [ç»Ÿä¸€å¼‚å¸¸å¤„ç†](#7-ç»Ÿä¸€å¼‚å¸¸å¤„ç†)
8. [è·¯ç”±ä¿æŠ¤æœºåˆ¶](#8-è·¯ç”±ä¿æŠ¤æœºåˆ¶)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” TokenéªŒè¯åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯TokenéªŒè¯


**ç®€å•ç†è§£**ï¼šTokenéªŒè¯å°±åƒé—¨å«æ£€æŸ¥é—¨ç¦å¡ä¸€æ ·ï¼Œæ¯æ¬¡ç”¨æˆ·è®¿é—®éœ€è¦ä¿æŠ¤çš„èµ„æºæ—¶ï¼Œéƒ½è¦å‡ºç¤º"é€šè¡Œè¯"ï¼ˆTokenï¼‰ã€‚

```
ç”¨æˆ·ç™»å½•æˆåŠŸ â†’ æœåŠ¡å™¨é¢å‘Token â†’ ç”¨æˆ·æºå¸¦Tokenè®¿é—® â†’ æœåŠ¡å™¨éªŒè¯Token â†’ å…è®¸/æ‹’ç»è®¿é—®

å°±åƒè¿™æ ·ï¼š
å®¢æˆ·ç«¯: "æˆ‘è¦è®¿é—®ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ˜¯æˆ‘çš„Tokenï¼šeyJhbGciOiJIUzI1NiJ9..."
æœåŠ¡ç«¯: "è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹...Tokenæœ‰æ•ˆï¼Œä½ å¯ä»¥è®¿é—®"
```

### 1.2 TokenéªŒè¯çš„æ ¸å¿ƒä½œç”¨


**ğŸ”¸ èº«ä»½ç¡®è®¤**ï¼šç¡®å®š"ä½ æ˜¯è°"
```
TokenåŒ…å«ç”¨æˆ·ä¿¡æ¯ â†’ è§£æåçŸ¥é“æ˜¯å¼ ä¸‰è¿˜æ˜¯æå››
```

**ğŸ”¸ æƒé™æ§åˆ¶**ï¼šç¡®å®š"ä½ èƒ½åšä»€ä¹ˆ"  
```
æ™®é€šç”¨æˆ·Token â†’ åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ä¿¡æ¯
ç®¡ç†å‘˜Token â†’ å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯
```

**ğŸ”¸ çŠ¶æ€ç»´æŠ¤**ï¼šæœåŠ¡å™¨ä¸éœ€è¦è®°ä½ä½ çš„ç™»å½•çŠ¶æ€
```
ä¼ ç»ŸSessionï¼šæœåŠ¡å™¨å†…å­˜å­˜å‚¨"å¼ ä¸‰å·²ç™»å½•"
Tokenæ–¹å¼ï¼šTokenè‡ªå¸¦èº«ä»½ä¿¡æ¯ï¼ŒæœåŠ¡å™¨åªéœ€éªŒè¯çœŸå‡
```

### 1.3 éªŒè¯æµç¨‹æ¦‚è§ˆ


```
å®¢æˆ·ç«¯è¯·æ±‚æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é€è¯·æ±‚   â”‚â”€â”€â”€â–¶â”‚  æºå¸¦Token   â”‚â”€â”€â”€â–¶â”‚  è®¿é—®èµ„æº   â”‚
â”‚  (æµè§ˆå™¨)   â”‚    â”‚ (è¯·æ±‚å¤´ä¸­)   â”‚    â”‚ (APIæ¥å£)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœåŠ¡ç«¯éªŒè¯æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¥æ”¶è¯·æ±‚   â”‚â”€â”€â”€â–¶â”‚  éªŒè¯Token   â”‚â”€â”€â”€â–¶â”‚  è¿”å›ç»“æœ   â”‚
â”‚  (æ‹¦æˆªå™¨)   â”‚    â”‚ (ä¸­é—´ä»¶å¤„ç†) â”‚    â”‚ (æ•°æ®/é”™è¯¯) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ›¡ï¸ ä¸­é—´ä»¶éªŒè¯æœºåˆ¶


### 2.1 ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶


**å½¢è±¡æ¯”å–»**ï¼šä¸­é—´ä»¶å°±åƒå°åŒºçš„é—¨å«ï¼Œæ‰€æœ‰è¿›å…¥å°åŒºçš„äººéƒ½è¦åœ¨é—¨å«å¤„ç™»è®°éªŒè¯ï¼ŒéªŒè¯é€šè¿‡æ‰èƒ½è¿›å…¥ã€‚

```
è¯·æ±‚å¤„ç†é“¾æ¡ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ä¸­é—´ä»¶éªŒè¯ â†’ ä¸šåŠ¡é€»è¾‘ â†’ è¿”å›å“åº”

å°±åƒè¿™æ ·ï¼š
å¤–å–å‘˜ â†’ é—¨å«æ£€æŸ¥ â†’ è¿›å…¥å°åŒº â†’ é€è¾¾ç”¨æˆ·
```

### 2.2 ä¸­é—´ä»¶çš„å·¥ä½œåŸç†


```java
// ğŸ”¸ Express.js é£æ ¼çš„ä¸­é—´ä»¶ç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
public class TokenMiddleware {
    
    public void process(Request request, Response response, Next next) {
        // 1. ä»è¯·æ±‚å¤´è·å–Token
        String token = request.getHeader("Authorization");
        
        // 2. éªŒè¯Token
        if (isValidToken(token)) {
            // Tokenæœ‰æ•ˆï¼Œç»§ç»­å¤„ç†
            next.execute();  // æ”¾è¡Œåˆ°ä¸‹ä¸€æ­¥
        } else {
            // Tokenæ— æ•ˆï¼Œç›´æ¥è¿”å›é”™è¯¯
            response.setStatus(401);
            response.setBody("Tokenæ— æ•ˆï¼Œè¯·é‡æ–°ç™»å½•");
        }
    }
}
```

### 2.3 Spring Bootä¸­çš„Tokenæ‹¦æˆªå™¨


```java
// ğŸ”¸ åˆ›å»ºTokenéªŒè¯æ‹¦æˆªå™¨
@Component
public class TokenInterceptor implements HandlerInterceptor {
    
    @Autowired
    private TokenService tokenService;
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        
        // 1ï¸âƒ£ è·å–Tokenï¼ˆé€šå¸¸åœ¨è¯·æ±‚å¤´ä¸­ï¼‰
        String token = request.getHeader("Authorization");
        if (token != null && token.startsWith("Bearer ")) {
            token = token.substring(7); // å»æ‰ "Bearer " å‰ç¼€
        }
        
        // 2ï¸âƒ£ éªŒè¯Token
        try {
            UserInfo userInfo = tokenService.validateToken(token);
            // 3ï¸âƒ£ å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­ï¼Œä¾›åç»­ä½¿ç”¨
            request.setAttribute("currentUser", userInfo);
            return true; // éªŒè¯é€šè¿‡ï¼Œç»§ç»­å¤„ç†
        } catch (Exception e) {
            // 4ï¸âƒ£ éªŒè¯å¤±è´¥ï¼Œè¿”å›é”™è¯¯
            response.setStatus(401);
            return false; // æ‹¦æˆªè¯·æ±‚ï¼Œä¸ç»§ç»­å¤„ç†
        }
    }
}
```

### 2.4 é…ç½®æ‹¦æˆªå™¨


```java
// ğŸ”¸ æ³¨å†Œæ‹¦æˆªå™¨
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Autowired
    private TokenInterceptor tokenInterceptor;
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(tokenInterceptor)
                .addPathPatterns("/api/**")        // éœ€è¦éªŒè¯çš„è·¯å¾„
                .excludePathPatterns(              // ä¸éœ€è¦éªŒè¯çš„è·¯å¾„
                    "/api/login",                  // ç™»å½•æ¥å£
                    "/api/register",               // æ³¨å†Œæ¥å£
                    "/api/public/**"               // å…¬å¼€æ¥å£
                );
    }
}
```

**é€šä¿—è§£é‡Š**ï¼š
- `addPathPatterns`ï¼šå“ªäº›è·¯å¾„éœ€è¦é—¨å«æ£€æŸ¥
- `excludePathPatterns`ï¼šå“ªäº›è·¯å¾„å¯ä»¥è‡ªç”±å‡ºå…¥ï¼ˆæ¯”å¦‚è®¿å®¢ç™»è®°å¤„ï¼‰

---

## 3. ğŸ” Tokenè§£ææµç¨‹


### 3.1 Tokençš„ç»„æˆç»“æ„


**JWT Tokençš„ç»„æˆ**ï¼ˆæœ€å¸¸ç”¨çš„Tokenæ ¼å¼ï¼‰ï¼š
```
eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEsInVzZXJuYW1lIjoidGVzdCJ9.signature

åˆ†æˆä¸‰éƒ¨åˆ†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€ å¤´éƒ¨ â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€ è½½è· â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€ ç­¾å â”€â”€â”€â”
â”‚  Header         â”‚.â”‚   Payload        â”‚.â”‚ Signature  â”‚
â”‚ (ç®—æ³•ä¿¡æ¯)       â”‚ â”‚ (ç”¨æˆ·ä¿¡æ¯)       â”‚ â”‚ (é˜²ä¼ªæ ‡è¯†) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Tokenè§£ææ­¥éª¤


```java
// ğŸ”¸ Tokenè§£ææœåŠ¡
@Service
public class TokenService {
    
    private final String SECRET_KEY = "my-secret-key"; // å¯†é’¥
    
    public UserInfo validateToken(String token) {
        try {
            // 1ï¸âƒ£ åˆ†å‰²Tokenï¼ˆä»¥.åˆ†éš”ï¼‰
            String[] parts = token.split("\\.");
            if (parts.length != 3) {
                throw new IllegalArgumentException("Tokenæ ¼å¼é”™è¯¯");
            }
            
            // 2ï¸âƒ£ è§£æå¤´éƒ¨ï¼ˆHeaderï¼‰
            String header = new String(Base64.decode(parts[0]));
            // headerå†…å®¹åƒè¿™æ ·ï¼š{"alg":"HS256","typ":"JWT"}
            
            // 3ï¸âƒ£ è§£æè½½è·ï¼ˆPayloadï¼‰
            String payload = new String(Base64.decode(parts[1]));
            // payloadå†…å®¹åƒè¿™æ ·ï¼š{"userId":1,"username":"test","exp":1640995200}
            
            // 4ï¸âƒ£ éªŒè¯ç­¾åï¼ˆæœ€é‡è¦çš„ä¸€æ­¥ï¼‰
            String signature = parts[2];
            String expectedSignature = generateSignature(parts[0] + "." + parts[1]);
            
            if (!signature.equals(expectedSignature)) {
                throw new SecurityException("Tokenç­¾åéªŒè¯å¤±è´¥");
            }
            
            // 5ï¸âƒ£ æ£€æŸ¥è¿‡æœŸæ—¶é—´
            JSONObject payloadJson = JSON.parseObject(payload);
            long expiration = payloadJson.getLong("exp");
            if (System.currentTimeMillis() / 1000 > expiration) {
                throw new SecurityException("Tokenå·²è¿‡æœŸ");
            }
            
            // 6ï¸âƒ£ æå–ç”¨æˆ·ä¿¡æ¯
            UserInfo userInfo = new UserInfo();
            userInfo.setUserId(payloadJson.getInteger("userId"));
            userInfo.setUsername(payloadJson.getString("username"));
            
            return userInfo;
            
        } catch (Exception e) {
            throw new SecurityException("Tokenè§£æå¤±è´¥: " + e.getMessage());
        }
    }
    
    // ç”Ÿæˆç­¾åçš„æ–¹æ³•
    private String generateSignature(String data) {
        // ä½¿ç”¨HMAC-SHA256ç®—æ³•
        return HMAC.sha256(data, SECRET_KEY);
    }
}
```

### 3.3 è§£ææµç¨‹å›¾è§£


```
Tokenè§£æéªŒè¯æµç¨‹ï¼š

è¾“å…¥Token: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjF9.signature

ç¬¬ä¸€æ­¥ï¼šåˆ†å‰²Token
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Header      â”‚  â”‚    Payload      â”‚  â”‚   Signature     â”‚
â”‚ eyJhbGciOiJI... â”‚  â”‚ eyJ1c2VySWQ... â”‚  â”‚  signature...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒæ­¥ï¼šBase64è§£ç 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚{"alg":"HS256"}  â”‚  â”‚{"userId":1,     â”‚  â”‚   ä¿æŒåŸæ ·      â”‚
â”‚                 â”‚  â”‚ "exp":1640995}  â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸‰æ­¥ï¼šéªŒè¯ç­¾å
ç”¨Header+Payloadé‡æ–°è®¡ç®—ç­¾å â†’ ä¸åŸç­¾åå¯¹æ¯” â†’ åˆ¤æ–­æ˜¯å¦è¢«ç¯¡æ”¹

ç¬¬å››æ­¥ï¼šæ£€æŸ¥æœ‰æ•ˆæœŸ
å½“å‰æ—¶é—´ vs Tokenä¸­çš„expæ—¶é—´ â†’ åˆ¤æ–­æ˜¯å¦è¿‡æœŸ

ç¬¬äº”æ­¥ï¼šæå–ç”¨æˆ·ä¿¡æ¯
ä»Payloadä¸­è·å–userIdã€usernameç­‰ä¿¡æ¯
```

---

## 4. ğŸ”‘ æƒé™æ ¡éªŒé€»è¾‘


### 4.1 æƒé™æ§åˆ¶çš„å±‚æ¬¡


**æƒé™æ§åˆ¶å°±åƒå…¬å¸çš„é—¨ç¦ç³»ç»Ÿ**ï¼š

```
å…¬å¸æƒé™å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CEO (æœ€é«˜æƒé™)             â”‚ â† å¯ä»¥è¿›å…¥æ‰€æœ‰åŒºåŸŸ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        éƒ¨é—¨ç»ç† (ç®¡ç†æƒé™)           â”‚ â† å¯ä»¥è¿›å…¥è‡ªå·±éƒ¨é—¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        æ™®é€šå‘˜å·¥ (åŸºç¡€æƒé™)           â”‚ â† åªèƒ½è¿›å…¥åŠå…¬åŒº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         è®¿å®¢ (ä¸´æ—¶æƒé™)              â”‚ â† åªèƒ½åœ¨å¤§å…æ´»åŠ¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åŸºäºè§’è‰²çš„æƒé™æ ¡éªŒï¼ˆRBACï¼‰


```java
// ğŸ”¸ æƒé™æ ¡éªŒæœåŠ¡
@Service
public class PermissionService {
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®æŸä¸ªèµ„æºçš„æƒé™
    public boolean hasPermission(UserInfo user, String resource, String action) {
        
        // 1ï¸âƒ£ è·å–ç”¨æˆ·çš„è§’è‰²
        List<String> userRoles = getUserRoles(user.getUserId());
        
        // 2ï¸âƒ£ è·å–æ¯ä¸ªè§’è‰²çš„æƒé™
        Set<String> permissions = new HashSet<>();
        for (String role : userRoles) {
            permissions.addAll(getRolePermissions(role));
        }
        
        // 3ï¸âƒ£ æ£€æŸ¥æ˜¯å¦æœ‰æ‰€éœ€çš„æƒé™
        String requiredPermission = resource + ":" + action;
        return permissions.contains(requiredPermission);
    }
    
    // è·å–ç”¨æˆ·è§’è‰²çš„æ–¹æ³•
    private List<String> getUserRoles(Integer userId) {
        // ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·è§’è‰²
        // æ¯”å¦‚ï¼š["admin", "user"]
        return userRoleMapper.selectRolesByUserId(userId);
    }
    
    // è·å–è§’è‰²æƒé™çš„æ–¹æ³•  
    private List<String> getRolePermissions(String role) {
        // ä»æ•°æ®åº“æˆ–é…ç½®æ–‡ä»¶æŸ¥è¯¢è§’è‰²æƒé™
        // æ¯”å¦‚ï¼šadminè§’è‰²æœ‰["user:read", "user:write", "user:delete"]
        return rolePermissionMapper.selectPermissionsByRole(role);
    }
}
```

### 4.3 æƒé™æ³¨è§£çš„ä½¿ç”¨


```java
// ğŸ”¸ è‡ªå®šä¹‰æƒé™æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequirePermission {
    String resource(); // èµ„æºåç§°
    String action();   // æ“ä½œç±»å‹
}

// ğŸ”¸ åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šä½¿ç”¨æ³¨è§£
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping("/list")
    @RequirePermission(resource = "user", action = "read")
    public List<User> getUserList() {
        // è·å–ç”¨æˆ·åˆ—è¡¨çš„ä¸šåŠ¡é€»è¾‘
        return userService.getAllUsers();
    }
    
    @PostMapping("/create")  
    @RequirePermission(resource = "user", action = "write")
    public User createUser(@RequestBody User user) {
        // åˆ›å»ºç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘
        return userService.createUser(user);
    }
    
    @DeleteMapping("/{id}")
    @RequirePermission(resource = "user", action = "delete") 
    public void deleteUser(@PathVariable Integer id) {
        // åˆ é™¤ç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘
        userService.deleteUser(id);
    }
}
```

### 4.4 æƒé™æ ¡éªŒåˆ‡é¢


```java
// ğŸ”¸ æƒé™æ ¡éªŒçš„AOPåˆ‡é¢
@Aspect
@Component
public class PermissionAspect {
    
    @Autowired
    private PermissionService permissionService;
    
    @Around("@annotation(requirePermission)")
    public Object checkPermission(ProceedingJoinPoint joinPoint, 
                                RequirePermission requirePermission) throws Throwable {
        
        // 1ï¸âƒ£ è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
        HttpServletRequest request = 
            ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes())
            .getRequest();
        UserInfo currentUser = (UserInfo) request.getAttribute("currentUser");
        
        // 2ï¸âƒ£ æ£€æŸ¥æƒé™
        boolean hasPermission = permissionService.hasPermission(
            currentUser, 
            requirePermission.resource(), 
            requirePermission.action()
        );
        
        // 3ï¸âƒ£ æ ¹æ®æƒé™æ£€æŸ¥ç»“æœå†³å®šæ˜¯å¦æ‰§è¡Œæ–¹æ³•
        if (hasPermission) {
            return joinPoint.proceed(); // æœ‰æƒé™ï¼Œæ‰§è¡ŒåŸæ–¹æ³•
        } else {
            throw new SecurityException("æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®è¯¥èµ„æº");
        }
    }
}
```

**é€šä¿—è§£é‡Šæƒé™æ ¡éªŒæµç¨‹**ï¼š
1. ç”¨æˆ·è®¿é—®æ¥å£ â†’ "æˆ‘è¦æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨"
2. TokenéªŒè¯é€šè¿‡ â†’ "ç¡®è®¤ä½ æ˜¯å¼ ä¸‰"  
3. æƒé™æ£€æŸ¥ â†’ "å¼ ä¸‰æ˜¯ç®¡ç†å‘˜ï¼Œæœ‰user:readæƒé™"
4. æ‰§è¡Œä¸šåŠ¡é€»è¾‘ â†’ "å¯ä»¥æŸ¥çœ‹ï¼Œè¿”å›ç”¨æˆ·åˆ—è¡¨"

---

## 5. âš ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶


### 5.1 TokenéªŒè¯ä¸­çš„å¸¸è§å¼‚å¸¸


**å°±åƒé—¨å«æ£€æŸ¥èº«ä»½è¯æ—¶å¯èƒ½é‡åˆ°çš„æƒ…å†µ**ï¼š

```
å¼‚å¸¸ç±»å‹å¯¹ç…§è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¼‚å¸¸æƒ…å†µ      â”‚     ç°å®æ¯”å–»    â”‚   å¤„ç†æ–¹å¼      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tokenç¼ºå¤±      â”‚   å¿˜å¸¦èº«ä»½è¯    â”‚   æ‹’ç»å…¥å†…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tokenæ ¼å¼é”™è¯¯  â”‚   èº«ä»½è¯æ˜¯å‡çš„  â”‚   ç«‹å³æŠ¥è­¦      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tokenå·²è¿‡æœŸ    â”‚   èº«ä»½è¯è¿‡æœŸäº†  â”‚   è¦æ±‚æ›´æ–°      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tokenè¢«ç¯¡æ”¹    â”‚   èº«ä»½è¯è¢«ä¿®æ”¹  â”‚   æ‹’ç»å¹¶è®°å½•    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æƒé™ä¸è¶³       â”‚   ä¸æ˜¯æœ¬æ¥¼ä½æˆ·  â”‚   ç¤¼è²Œæ‹’ç»      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 è‡ªå®šä¹‰å¼‚å¸¸ç±»


```java
// ğŸ”¸ Tokenç›¸å…³çš„å¼‚å¸¸ç±»
public class TokenException extends RuntimeException {
    private final int code;
    
    public TokenException(int code, String message) {
        super(message);
        this.code = code;
    }
    
    // å…·ä½“çš„å¼‚å¸¸å­ç±»
    public static class TokenMissingException extends TokenException {
        public TokenMissingException() {
            super(40001, "Tokenç¼ºå¤±ï¼Œè¯·å…ˆç™»å½•");
        }
    }
    
    public static class TokenExpiredException extends TokenException {
        public TokenExpiredException() {
            super(40002, "Tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•");
        }
    }
    
    public static class TokenInvalidException extends TokenException {
        public TokenInvalidException() {
            super(40003, "Tokenæ— æ•ˆï¼Œè¯·æ£€æŸ¥æ ¼å¼");
        }
    }
    
    public static class PermissionDeniedException extends TokenException {
        public PermissionDeniedException() {
            super(40003, "æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®è¯¥èµ„æº");
        }
    }
}
```

### 5.3 å¼‚å¸¸å¤„ç†é€»è¾‘


```java
// ğŸ”¸ æ”¹è¿›çš„TokenéªŒè¯æœåŠ¡ï¼ˆå¸¦å¼‚å¸¸å¤„ç†ï¼‰
@Service
public class TokenService {
    
    public UserInfo validateToken(String token) {
        // 1ï¸âƒ£ æ£€æŸ¥Tokenæ˜¯å¦å­˜åœ¨
        if (token == null || token.trim().isEmpty()) {
            throw new TokenException.TokenMissingException();
        }
        
        try {
            // 2ï¸âƒ£ è§£æToken
            String[] parts = token.split("\\.");
            if (parts.length != 3) {
                throw new TokenException.TokenInvalidException();
            }
            
            // 3ï¸âƒ£ éªŒè¯ç­¾å
            if (!isSignatureValid(parts)) {
                throw new TokenException.TokenInvalidException();
            }
            
            // 4ï¸âƒ£ æ£€æŸ¥è¿‡æœŸæ—¶é—´
            JSONObject payload = parsePayload(parts[1]);
            if (isTokenExpired(payload)) {
                throw new TokenException.TokenExpiredException();
            }
            
            // 5ï¸âƒ£ è¿”å›ç”¨æˆ·ä¿¡æ¯
            return extractUserInfo(payload);
            
        } catch (TokenException e) {
            // é‡æ–°æŠ›å‡ºTokenç›¸å…³å¼‚å¸¸
            throw e;
        } catch (Exception e) {
            // å°†å…¶ä»–å¼‚å¸¸åŒ…è£…æˆTokenæ— æ•ˆå¼‚å¸¸
            throw new TokenException.TokenInvalidException();
        }
    }
    
    private boolean isTokenExpired(JSONObject payload) {
        long expiration = payload.getLong("exp");
        long currentTime = System.currentTimeMillis() / 1000;
        return currentTime > expiration;
    }
}
```

### 5.4 å¼‚å¸¸å“åº”æ ¼å¼


```java
// ğŸ”¸ ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
public class ErrorResponse {
    private int code;          // é”™è¯¯ä»£ç 
    private String message;    // é”™è¯¯ä¿¡æ¯
    private long timestamp;    // æ—¶é—´æˆ³
    private String path;       // è¯·æ±‚è·¯å¾„
    
    // æ„é€ æ–¹æ³•å’Œgetter/setter
    public ErrorResponse(int code, String message, String path) {
        this.code = code;
        this.message = message;  
        this.timestamp = System.currentTimeMillis();
        this.path = path;
    }
}
```

**å¼‚å¸¸å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 40002,
  "message": "Tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",
  "timestamp": 1640995200000,
  "path": "/api/users/list"
}
```

---

## 6. âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§


### 6.1 Tokenç¼“å­˜æœºåˆ¶


**é—®é¢˜**ï¼šæ¯æ¬¡è¯·æ±‚éƒ½è¦è§£æå’ŒéªŒè¯Tokenï¼Œå¾ˆè€—æ—¶
**è§£å†³**ï¼šæŠŠéªŒè¯ç»“æœç¼“å­˜èµ·æ¥ï¼Œå°±åƒåŠç†VIPå¡ä¸€æ ·

```java
// ğŸ”¸ ä½¿ç”¨Redisç¼“å­˜TokenéªŒè¯ç»“æœ
@Service
public class CachedTokenService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private final int CACHE_EXPIRE_TIME = 300; // ç¼“å­˜5åˆ†é’Ÿ
    
    public UserInfo validateTokenWithCache(String token) {
        // 1ï¸âƒ£ å…ˆä»ç¼“å­˜æŸ¥æ‰¾
        String cacheKey = "token:" + token.hashCode(); // ç”¨hashé¿å…keyå¤ªé•¿
        UserInfo cachedUser = (UserInfo) redisTemplate.opsForValue().get(cacheKey);
        
        if (cachedUser != null) {
            // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›
            return cachedUser;
        }
        
        // 2ï¸âƒ£ ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡ŒçœŸæ­£çš„TokenéªŒè¯
        UserInfo userInfo = validateToken(token); // è°ƒç”¨åŸæ¥çš„éªŒè¯æ–¹æ³•
        
        // 3ï¸âƒ£ å°†éªŒè¯ç»“æœæ”¾å…¥ç¼“å­˜
        redisTemplate.opsForValue().set(cacheKey, userInfo, CACHE_EXPIRE_TIME, TimeUnit.SECONDS);
        
        return userInfo;
    }
}
```

### 6.2 æ‰¹é‡æƒé™æŸ¥è¯¢


**é—®é¢˜**ï¼šæ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“è·å–ç”¨æˆ·æƒé™
**è§£å†³**ï¼šä¸€æ¬¡æŸ¥è¯¢ï¼Œå¤šæ¬¡ä½¿ç”¨

```java
// ğŸ”¸ æ‰¹é‡åŠ è½½ç”¨æˆ·æƒé™
@Service
public class OptimizedPermissionService {
    
    // ä½¿ç”¨æœ¬åœ°ç¼“å­˜é¿å…é‡å¤æŸ¥è¯¢
    private final LoadingCache<Integer, Set<String>> userPermissionCache = 
        Caffeine.newBuilder()
                .maximumSize(1000)           // æœ€å¤šç¼“å­˜1000ä¸ªç”¨æˆ·çš„æƒé™
                .expireAfterWrite(10, TimeUnit.MINUTES) // 10åˆ†é’Ÿåè¿‡æœŸ
                .build(this::loadUserPermissions); // ç¼“å­˜æœªå‘½ä¸­æ—¶çš„åŠ è½½æ–¹æ³•
    
    public boolean hasPermission(UserInfo user, String resource, String action) {
        try {
            // ä»ç¼“å­˜è·å–ç”¨æˆ·æƒé™
            Set<String> permissions = userPermissionCache.get(user.getUserId());
            String requiredPermission = resource + ":" + action;
            return permissions.contains(requiredPermission);
        } catch (Exception e) {
            return false; // å‡ºé”™æ—¶æ‹’ç»è®¿é—®
        }
    }
    
    // åŠ è½½ç”¨æˆ·æƒé™çš„æ–¹æ³•ï¼ˆåªåœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶è°ƒç”¨ï¼‰
    private Set<String> loadUserPermissions(Integer userId) {
        // ä¸€æ¬¡æ€§æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰æƒé™
        List<String> roles = userRoleMapper.selectRolesByUserId(userId);
        Set<String> permissions = new HashSet<>();
        
        for (String role : roles) {
            permissions.addAll(rolePermissionMapper.selectPermissionsByRole(role));
        }
        
        return permissions;
    }
}
```

### 6.3 å¼‚æ­¥æ—¥å¿—è®°å½•


**é—®é¢˜**ï¼šè®°å½•è®¿é—®æ—¥å¿—å½±å“æ¥å£å“åº”é€Ÿåº¦
**è§£å†³**ï¼šå¼‚æ­¥è®°å½•æ—¥å¿—ï¼Œä¸é˜»å¡ä¸»æµç¨‹

```java
// ğŸ”¸ å¼‚æ­¥æ—¥å¿—è®°å½•
@Component
public class AsyncSecurityLogger {
    
    // åˆ›å»ºå¼‚æ­¥æ‰§è¡Œå™¨
    @Async("securityLogExecutor")
    public void logSecurityEvent(String event, UserInfo user, String details) {
        // è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸å½±å“ä¸»è¯·æ±‚
        SecurityLog log = new SecurityLog();
        log.setEvent(event);
        log.setUserId(user.getUserId());
        log.setUsername(user.getUsername());
        log.setDetails(details);
        log.setTimestamp(new Date());
        
        // ä¿å­˜åˆ°æ•°æ®åº“
        securityLogMapper.insert(log);
    }
}

// é…ç½®å¼‚æ­¥æ‰§è¡Œå™¨
@Configuration
@EnableAsync
public class AsyncConfig {
    
    @Bean("securityLogExecutor")
    public TaskExecutor securityLogExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(2);        // æ ¸å¿ƒçº¿ç¨‹æ•°
        executor.setMaxPoolSize(5);         // æœ€å¤§çº¿ç¨‹æ•°  
        executor.setQueueCapacity(100);     // é˜Ÿåˆ—å®¹é‡
        executor.setThreadNamePrefix("SecurityLog-");
        executor.initialize();
        return executor;
    }
}
```

### 6.4 ä¼˜åŒ–å»ºè®®æ€»ç»“


```
æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ä¼˜åŒ–æ–¹é¢      â”‚      ä¼˜åŒ–ç­–ç•¥    â”‚      æ•ˆæœæå‡    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TokenéªŒè¯ç¼“å­˜   â”‚   Redisç¼“å­˜ç»“æœ  â”‚   å“åº”æ—¶é—´å‡å°‘80% â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æƒé™æŸ¥è¯¢ç¼“å­˜    â”‚   æœ¬åœ°å†…å­˜ç¼“å­˜   â”‚   æ•°æ®åº“å‹åŠ›å‡å°‘90% â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¼‚æ­¥æ—¥å¿—è®°å½•    â”‚   ç‹¬ç«‹çº¿ç¨‹å¤„ç†   â”‚   æ¥å£å»¶è¿Ÿå‡å°‘50% â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‰¹é‡æ•°æ®åŠ è½½    â”‚   ä¸€æ¬¡æŸ¥è¯¢å¤šæ¬¡ç”¨ â”‚   æ•°æ®åº“è°ƒç”¨å‡å°‘70% â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ğŸš¨ ç»Ÿä¸€å¼‚å¸¸å¤„ç†


### 7.1 å…¨å±€å¼‚å¸¸å¤„ç†å™¨


**ç›®æ ‡**ï¼šè®©æ‰€æœ‰çš„Tokenç›¸å…³å¼‚å¸¸éƒ½èƒ½å¾—åˆ°ç»Ÿä¸€ã€å‹å¥½çš„å¤„ç†

```java
// ğŸ”¸ å…¨å±€å¼‚å¸¸å¤„ç†å™¨
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    private static final Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);
    
    // å¤„ç†Tokenç›¸å…³å¼‚å¸¸
    @ExceptionHandler(TokenException.class)
    public ResponseEntity<ErrorResponse> handleTokenException(
            TokenException e, HttpServletRequest request) {
        
        // è®°å½•å¼‚å¸¸æ—¥å¿—
        logger.warn("Tokenå¼‚å¸¸: {} - {}", e.getCode(), e.getMessage());
        
        // åˆ›å»ºé”™è¯¯å“åº”
        ErrorResponse errorResponse = new ErrorResponse(
            e.getCode(),
            e.getMessage(),
            request.getRequestURI()
        );
        
        // è¿”å›401çŠ¶æ€ç 
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(errorResponse);
    }
    
    // å¤„ç†æƒé™ä¸è¶³å¼‚å¸¸
    @ExceptionHandler(PermissionDeniedException.class)
    public ResponseEntity<ErrorResponse> handlePermissionException(
            PermissionDeniedException e, HttpServletRequest request) {
        
        logger.warn("æƒé™ä¸è¶³: {}", e.getMessage());
        
        ErrorResponse errorResponse = new ErrorResponse(
            40003,
            "æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®è¯¥èµ„æº",
            request.getRequestURI()
        );
        
        // è¿”å›403çŠ¶æ€ç 
        return ResponseEntity.status(HttpStatus.FORBIDDEN).body(errorResponse);
    }
    
    // å¤„ç†å…¶ä»–æœªçŸ¥å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGenericException(
            Exception e, HttpServletRequest request) {
        
        logger.error("æœªçŸ¥å¼‚å¸¸: ", e);
        
        ErrorResponse errorResponse = new ErrorResponse(
            50000,
            "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•",
            request.getRequestURI()
        );
        
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
    }
}
```

### 7.2 å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ


```java
// ğŸ”¸ å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µç¤ºä¾‹
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping("/{id}")
    public User getUser(@PathVariable Integer id) {
        // ä¸šåŠ¡é€»è¾‘ä¸­ä¸éœ€è¦å¤„ç†Tokenå¼‚å¸¸
        // å› ä¸ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨ä¼šè‡ªåŠ¨å¤„ç†
        
        // åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘æœ¬èº«
        User user = userService.getById(id);
        if (user == null) {
            throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
        }
        return user;
    }
}
```

**ä¼˜åŠ¿è¯´æ˜**ï¼š
- âœ… **ä»£ç ç®€æ´**ï¼šä¸šåŠ¡ä»£ç ä¸éœ€è¦å¤„ç†Tokenå¼‚å¸¸
- âœ… **å“åº”ç»Ÿä¸€**ï¼šæ‰€æœ‰å¼‚å¸¸éƒ½æœ‰ç»Ÿä¸€çš„å“åº”æ ¼å¼
- âœ… **æ—¥å¿—å®Œæ•´**ï¼šå¼‚å¸¸ä¼šè¢«è‡ªåŠ¨è®°å½•åˆ°æ—¥å¿—ä¸­
- âœ… **ç»´æŠ¤æ–¹ä¾¿**ï¼šå¼‚å¸¸å¤„ç†é€»è¾‘é›†ä¸­ç®¡ç†

### 7.3 å¼‚å¸¸å¤„ç†æµç¨‹å›¾


```
å¼‚å¸¸å¤„ç†æµç¨‹ï¼š

ç”¨æˆ·è¯·æ±‚ â†’ TokenéªŒè¯ â†’ ä¸šåŠ¡é€»è¾‘ â†’ å“åº”ç”¨æˆ·
    â†“          â†“          â†“
å¼‚å¸¸å‘ç”Ÿ â†’ å¼‚å¸¸æ•è· â†’ å…¨å±€å¤„ç†å™¨ â†’ ç»Ÿä¸€å“åº”

å…·ä½“ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tokenè¿‡æœŸ  â”‚â”€â”€â–¶â”‚  æŠ›å‡ºå¼‚å¸¸    â”‚â”€â”€â–¶â”‚  å…¨å±€æ•è·   â”‚
â”‚             â”‚   â”‚TokenExpired  â”‚   â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›401   â”‚â—€â”€â”€â”‚   è®°å½•æ—¥å¿—    â”‚â—€â”€â”€â”‚  æ ¼å¼åŒ–å“åº” â”‚
â”‚   çŠ¶æ€ç     â”‚   â”‚              â”‚   â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ğŸ›¡ï¸ è·¯ç”±ä¿æŠ¤æœºåˆ¶


### 8.1 ä»€ä¹ˆæ˜¯è·¯ç”±ä¿æŠ¤


**ç®€å•ç†è§£**ï¼šè·¯ç”±ä¿æŠ¤å°±åƒç»™ä¸åŒçš„æˆ¿é—´å®‰è£…ä¸åŒç­‰çº§çš„é—¨é”

```
ç½‘ç«™è·¯ç”±ä¿æŠ¤ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     è·¯ç”±è·¯å¾„    â”‚    ä¿æŠ¤ç­‰çº§     â”‚    è®¿é—®è¦æ±‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   /api/login    â”‚      æ— ä¿æŠ¤     â”‚   ä»»ä½•äººå¯è®¿é—®   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   /api/profile  â”‚    ç™»å½•ä¿æŠ¤     â”‚   éœ€è¦Token     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   /api/admin/*  â”‚    æƒé™ä¿æŠ¤     â”‚   éœ€è¦ç®¡ç†å‘˜æƒé™ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   /api/system/* â”‚    é«˜çº§ä¿æŠ¤     â”‚   éœ€è¦ç³»ç»Ÿæƒé™   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 åŸºäºæ³¨è§£çš„è·¯ç”±ä¿æŠ¤


```java
// ğŸ”¸ è·¯ç”±ä¿æŠ¤æ³¨è§£
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
public @interface ProtectedRoute {
    boolean requireAuth() default true;        // æ˜¯å¦éœ€è¦ç™»å½•
    String[] roles() default {};               // éœ€è¦çš„è§’è‰²
    String[] permissions() default {};         // éœ€è¦çš„æƒé™
}

// ğŸ”¸ ä½¿ç”¨ç¤ºä¾‹
@RestController
@RequestMapping("/api")
public class ApiController {
    
    // å…¬å¼€æ¥å£ï¼Œä¸éœ€è¦ä¿æŠ¤
    @GetMapping("/public/info")
    public String getPublicInfo() {
        return "è¿™æ˜¯å…¬å¼€ä¿¡æ¯";
    }
    
    // éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®
    @GetMapping("/user/profile")
    @ProtectedRoute(requireAuth = true)
    public UserProfile getUserProfile() {
        return userService.getCurrentUserProfile();
    }
    
    // éœ€è¦ç®¡ç†å‘˜è§’è‰²
    @GetMapping("/admin/users") 
    @ProtectedRoute(roles = {"admin"})
    public List<User> getAllUsers() {
        return userService.getAllUsers();
    }
    
    // éœ€è¦ç‰¹å®šæƒé™
    @DeleteMapping("/admin/user/{id}")
    @ProtectedRoute(permissions = {"user:delete"})
    public void deleteUser(@PathVariable Integer id) {
        userService.deleteUser(id);
    }
}
```

### 8.3 è·¯ç”±ä¿æŠ¤åˆ‡é¢å®ç°


```java
// ğŸ”¸ è·¯ç”±ä¿æŠ¤åˆ‡é¢
@Aspect
@Component
public class RouteProtectionAspect {
    
    @Autowired
    private TokenService tokenService;
    
    @Autowired  
    private PermissionService permissionService;
    
    @Around("@annotation(protectedRoute)")
    public Object protectRoute(ProceedingJoinPoint joinPoint, 
                             ProtectedRoute protectedRoute) throws Throwable {
        
        HttpServletRequest request = getCurrentRequest();
        
        // 1ï¸âƒ£ æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•è®¤è¯
        if (protectedRoute.requireAuth()) {
            UserInfo currentUser = authenticateUser(request);
            
            // 2ï¸âƒ£ æ£€æŸ¥è§’è‰²è¦æ±‚
            if (protectedRoute.roles().length > 0) {
                checkRoles(currentUser, protectedRoute.roles());
            }
            
            // 3ï¸âƒ£ æ£€æŸ¥æƒé™è¦æ±‚  
            if (protectedRoute.permissions().length > 0) {
                checkPermissions(currentUser, protectedRoute.permissions());
            }
        }
        
        // 4ï¸âƒ£ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡ŒåŸæ–¹æ³•
        return joinPoint.proceed();
    }
    
    private UserInfo authenticateUser(HttpServletRequest request) {
        String token = extractToken(request);
        if (token == null) {
            throw new TokenException.TokenMissingException();
        }
        return tokenService.validateToken(token);
    }
    
    private void checkRoles(UserInfo user, String[] requiredRoles) {
        List<String> userRoles = getUserRoles(user);
        for (String requiredRole : requiredRoles) {
            if (userRoles.contains(requiredRole)) {
                return; // æœ‰ä»»æ„ä¸€ä¸ªè§’è‰²å³å¯
            }
        }
        throw new PermissionDeniedException("è§’è‰²æƒé™ä¸è¶³");
    }
    
    private void checkPermissions(UserInfo user, String[] requiredPermissions) {
        for (String permission : requiredPermissions) {
            String[] parts = permission.split(":");
            String resource = parts[0];
            String action = parts[1];
            
            if (!permissionService.hasPermission(user, resource, action)) {
                throw new PermissionDeniedException("æ“ä½œæƒé™ä¸è¶³");
            }
        }
    }
}
```

### 8.4 é…ç½®çº§åˆ«çš„è·¯ç”±ä¿æŠ¤


```java
// ğŸ”¸ Securityé…ç½®ç±»
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                // å…¬å¼€è·¯å¾„ï¼Œä¸éœ€è¦è®¤è¯
                .requestMatchers("/api/public/**", "/api/login", "/api/register")
                .permitAll()
                
                // ç”¨æˆ·ç›¸å…³æ¥å£ï¼Œéœ€è¦ç™»å½•
                .requestMatchers("/api/user/**")
                .authenticated()
                
                // ç®¡ç†å‘˜æ¥å£ï¼Œéœ€è¦ADMINè§’è‰²
                .requestMatchers("/api/admin/**")
                .hasRole("ADMIN")
                
                // ç³»ç»Ÿæ¥å£ï¼Œéœ€è¦SYSTEMè§’è‰²
                .requestMatchers("/api/system/**")
                .hasRole("SYSTEM")
                
                // å…¶ä»–æ‰€æœ‰æ¥å£éƒ½éœ€è¦è®¤è¯
                .anyRequest().authenticated()
            )
            .oauth2ResourceServer(oauth2 -> oauth2.jwt(withDefaults()));
            
        return http.build();
    }
}
```

### 8.5 åŠ¨æ€è·¯ç”±æƒé™æ§åˆ¶


```java
// ğŸ”¸ åŠ¨æ€æƒé™åˆ¤æ–­
@Service
public class DynamicPermissionService {
    
    public boolean hasPermissionForPath(UserInfo user, String path, String method) {
        
        // æ ¹æ®è·¯å¾„å’ŒHTTPæ–¹æ³•åŠ¨æ€åˆ¤æ–­æƒé™
        if (path.startsWith("/api/user/")) {
            // ç”¨æˆ·ç›¸å…³æ¥å£
            String userId = extractUserIdFromPath(path);
            return user.getUserId().toString().equals(userId) || hasAdminRole(user);
        }
        
        if (path.startsWith("/api/admin/")) {
            // ç®¡ç†å‘˜æ¥å£
            return hasAdminRole(user);
        }
        
        if (path.startsWith("/api/system/")) {
            // ç³»ç»Ÿæ¥å£
            return hasSystemRole(user);
        }
        
        // é»˜è®¤éœ€è¦ç™»å½•å³å¯
        return true;
    }
    
    private String extractUserIdFromPath(String path) {
        // ä»è·¯å¾„ä¸­æå–ç”¨æˆ·IDï¼Œä¾‹å¦‚ï¼š/api/user/123 -> 123
        String[] parts = path.split("/");
        return parts[parts.length - 1];
    }
}
```

**è·¯ç”±ä¿æŠ¤çš„æ ¸å¿ƒæ€è·¯**ï¼š
1. **åˆ†å±‚ä¿æŠ¤**ï¼šä¸åŒçš„è·¯å¾„éœ€è¦ä¸åŒç­‰çº§çš„ä¿æŠ¤
2. **çµæ´»é…ç½®**ï¼šæ”¯æŒæ³¨è§£ã€é…ç½®æ–‡ä»¶ã€åŠ¨æ€åˆ¤æ–­ç­‰å¤šç§æ–¹å¼
3. **ç»Ÿä¸€å¤„ç†**ï¼šæ‰€æœ‰ä¿æŠ¤é€»è¾‘é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…é‡å¤éªŒè¯ï¼Œåˆç†ä½¿ç”¨ç¼“å­˜

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¸­é—´ä»¶éªŒè¯ï¼šåƒé—¨å«ä¸€æ ·ï¼Œåœ¨å…¥å£å¤„ç»Ÿä¸€éªŒè¯èº«ä»½
ğŸ”¸ Tokenè§£æï¼šåˆ†è§£Tokenç»“æ„ï¼ŒéªŒè¯ç­¾åå’Œæœ‰æ•ˆæœŸ
ğŸ”¸ æƒé™æ ¡éªŒï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ç‰¹å®šèµ„æº
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šä¼˜é›…å¤„ç†å„ç§éªŒè¯å¤±è´¥çš„æƒ…å†µ
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šé€šè¿‡ç¼“å­˜å’Œå¼‚æ­¥å¤„ç†æå‡å“åº”é€Ÿåº¦
ğŸ”¸ è·¯ç”±ä¿æŠ¤ï¼šä¸ºä¸åŒçš„æ¥å£é…ç½®ä¸åŒç­‰çº§çš„ä¿æŠ¤
```

### 9.2 TokenéªŒè¯çš„å®Œæ•´æµç¨‹


```
TokenéªŒè¯å®Œæ•´æµç¨‹ï¼š

1ï¸âƒ£ æ¥æ”¶è¯·æ±‚
   â†“
2ï¸âƒ£ æå–Token (ä»è¯·æ±‚å¤´Authorizationå­—æ®µ)
   â†“  
3ï¸âƒ£ éªŒè¯Tokenæ ¼å¼å’Œç­¾å
   â†“
4ï¸âƒ£ æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ  
   â†“
5ï¸âƒ£ æå–ç”¨æˆ·ä¿¡æ¯
   â†“
6ï¸âƒ£ æ£€æŸ¥ç”¨æˆ·æƒé™
   â†“
7ï¸âƒ£ å…è®¸è®¿é—®æˆ–æ‹’ç»è¯·æ±‚

ä»»ä½•ä¸€æ­¥å¤±è´¥éƒ½ä¼šæŠ›å‡ºç›¸åº”å¼‚å¸¸ï¼Œç”±å…¨å±€å¼‚å¸¸å¤„ç†å™¨ç»Ÿä¸€å¤„ç†
```

### 9.3 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ä¸­é—´ä»¶éªŒè¯**
```
ç»Ÿä¸€æ€§ï¼šæ‰€æœ‰éœ€è¦ä¿æŠ¤çš„æ¥å£éƒ½ç»è¿‡åŒæ ·çš„éªŒè¯æµç¨‹
æ•ˆç‡ï¼šé¿å…åœ¨æ¯ä¸ªæ¥å£ä¸­é‡å¤ç¼–å†™éªŒè¯ä»£ç   
å®‰å…¨æ€§ï¼šé›†ä¸­å¤„ç†ï¼Œä¸æ˜“å‡ºç°é—æ¼
å¯ç»´æŠ¤æ€§ï¼šéªŒè¯é€»è¾‘é›†ä¸­ï¼Œä¾¿äºä¿®æ”¹å’Œå‡çº§
```

**ğŸ”¹ Tokenè§£æçš„å…³é”®æ­¥éª¤**
```
æ ¼å¼éªŒè¯ï¼šç¡®ä¿Tokenç»“æ„æ­£ç¡®ï¼ˆä¸‰æ®µå¼ï¼‰
ç­¾åéªŒè¯ï¼šç¡®ä¿Tokenæ²¡æœ‰è¢«ç¯¡æ”¹ï¼ˆæœ€é‡è¦ï¼‰
æ—¶æ•ˆéªŒè¯ï¼šç¡®ä¿Tokenæ²¡æœ‰è¿‡æœŸ
ä¿¡æ¯æå–ï¼šä»Tokenä¸­è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯
```

**ğŸ”¹ æƒé™æ ¡éªŒçš„æ ¸å¿ƒåŸç†**
```
è§’è‰²æ˜ å°„ï¼šç”¨æˆ· â†’ è§’è‰² â†’ æƒé™
æƒé™è¡¨è¾¾ï¼šèµ„æº:æ“ä½œ (å¦‚ user:read, user:write)
åŠ¨æ€æ£€æŸ¥ï¼šæ ¹æ®å½“å‰ç”¨æˆ·çš„è§’è‰²å’Œæƒé™å†³å®šæ˜¯å¦å…è®¸è®¿é—®
ç¼“å­˜ä¼˜åŒ–ï¼šé¿å…æ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“
```

### 9.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ å®‰å…¨æ€§æœ€ä½³å®è·µ**
- âœ… ä½¿ç”¨å¼ºéšæœºæ•°ç”ŸæˆTokenç­¾åå¯†é’¥
- âœ… è®¾ç½®åˆç†çš„Tokenè¿‡æœŸæ—¶é—´ï¼ˆä¸è¦å¤ªé•¿ï¼‰
- âœ… æ•æ„Ÿæ“ä½œè¦æ±‚é‡æ–°éªŒè¯èº«ä»½
- âœ… è®°å½•æ‰€æœ‰å®‰å…¨ç›¸å…³çš„æ“ä½œæ—¥å¿—
- âœ… å®šæœŸè½®æ¢ç­¾åå¯†é’¥

**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**  
- âœ… ä½¿ç”¨Redisç¼“å­˜TokenéªŒè¯ç»“æœ
- âœ… ä½¿ç”¨æœ¬åœ°ç¼“å­˜å­˜å‚¨ç”¨æˆ·æƒé™ä¿¡æ¯
- âœ… å¼‚æ­¥è®°å½•è®¿é—®æ—¥å¿—ï¼Œä¸é˜»å¡ä¸»æµç¨‹
- âœ… æ‰¹é‡æŸ¥è¯¢ç”¨æˆ·è§’è‰²å’Œæƒé™ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®
- âœ… åˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´

**ğŸ”§ å¼€å‘ç»´æŠ¤å»ºè®®**
- âœ… ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- âœ… æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ç»™å®¢æˆ·ç«¯
- âœ… æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆTokenã€OAuthç­‰ï¼‰
- âœ… æä¾›æƒé™ç®¡ç†çš„åå°ç•Œé¢
- âœ… ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### 9.5 å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ


| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **TokenéªŒè¯æ…¢** | æ¯æ¬¡éƒ½è¦è§£æå’ŒæŸ¥åº“ | ä½¿ç”¨Redisç¼“å­˜éªŒè¯ç»“æœ |
| **æƒé™æŸ¥è¯¢å¤š** | æ¯ä¸ªæ¥å£éƒ½æŸ¥è¯¢æƒé™ | æœ¬åœ°ç¼“å­˜ç”¨æˆ·æƒé™ä¿¡æ¯ |
| **å¼‚å¸¸ä¿¡æ¯ä¹±** | æ²¡æœ‰ç»Ÿä¸€å¼‚å¸¸å¤„ç† | å®ç°å…¨å±€å¼‚å¸¸å¤„ç†å™¨ |
| **æ—¥å¿—å½±å“æ€§èƒ½** | åŒæ­¥è®°å½•è®¿é—®æ—¥å¿— | æ”¹ä¸ºå¼‚æ­¥è®°å½•æ—¥å¿— |
| **Tokenæ³„éœ²é£é™©** | Tokenè¿‡æœŸæ—¶é—´å¤ªé•¿ | è®¾ç½®åˆç†è¿‡æœŸæ—¶é—´+åˆ·æ–°æœºåˆ¶ |

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- TokenéªŒè¯åƒé—¨å«æ£€æŸ¥èº«ä»½è¯ï¼Œè¦éªŒè¯çœŸå‡ã€æœ‰æ•ˆæœŸå’Œæƒé™
- ä¸­é—´ä»¶æ˜¯ç»Ÿä¸€çš„æ£€æŸ¥ç‚¹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡
- æƒé™æ§åˆ¶é‡‡ç”¨è§’è‰²-æƒé™æ¨¡å‹ï¼Œçµæ´»ä¸”æ˜“ç®¡ç†
- å¼‚å¸¸è¦ç»Ÿä¸€å¤„ç†ï¼Œç»™ç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯
- æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æ˜¯åˆç†ä½¿ç”¨ç¼“å­˜ï¼Œå‡å°‘é‡å¤è®¡ç®—