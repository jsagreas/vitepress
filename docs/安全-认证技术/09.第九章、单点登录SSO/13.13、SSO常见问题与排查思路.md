---
title: 13ã€SSOå¸¸è§é—®é¢˜ä¸æ’æŸ¥æ€è·¯
---
## ğŸ“š ç›®å½•

1. [SSOé—®é¢˜æ’æŸ¥æ¦‚è¿°](#1-SSOé—®é¢˜æ’æŸ¥æ¦‚è¿°)
2. [ç™»å½•è·³è½¬æ­»å¾ªç¯é—®é¢˜](#2-ç™»å½•è·³è½¬æ­»å¾ªç¯é—®é¢˜)
3. [Tokenå¤±æ•ˆä½†SessionæœªåŒæ­¥](#3-Tokenå¤±æ•ˆä½†SessionæœªåŒæ­¥)
4. [å¤šæµè§ˆå™¨å¤šè®¾å¤‡å…¼å®¹é—®é¢˜](#4-å¤šæµè§ˆå™¨å¤šè®¾å¤‡å…¼å®¹é—®é¢˜)
5. [è´Ÿè½½å‡è¡¡å¯¼è‡´çš„ä¼šè¯ä¸¢å¤±](#5-è´Ÿè½½å‡è¡¡å¯¼è‡´çš„ä¼šè¯ä¸¢å¤±)
6. [è°ƒè¯•å·¥å…·ä¸æŠ“åŒ…åˆ†æ](#6-è°ƒè¯•å·¥å…·ä¸æŠ“åŒ…åˆ†æ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” SSOé—®é¢˜æ’æŸ¥æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯SSOé—®é¢˜æ’æŸ¥


**ğŸ”¸ ç®€å•ç†è§£**
```
SSOé—®é¢˜æ’æŸ¥å°±åƒä¿®ç†è¿é”åº—çš„ä¼šå‘˜ç³»ç»Ÿï¼š
- ä¸€ä¸ªé—¨åº—ç™»å½•åï¼Œå…¶ä»–é—¨åº—ä¹Ÿåº”è¯¥è®¤è¯†ä½ 
- ä½†æœ‰æ—¶å€™ä¼šå‡ºç°"è®°å¿†æ··ä¹±"çš„æƒ…å†µ
- éœ€è¦æ‰¾åˆ°é—®é¢˜æ ¹æºï¼Œè®©æ•´ä¸ªç³»ç»Ÿé‡æ–°"è®°ä½"ç”¨æˆ·
```

**ğŸ’¡ SSOé—®é¢˜çš„æœ¬è´¨**
```
æ ¸å¿ƒé—®é¢˜ï¼šå¤šä¸ªåº”ç”¨ä¹‹é—´çš„"æ²Ÿé€š"å‡ºç°äº†æ•…éšœ

å¸¸è§è¡¨ç°ï¼š
â€¢ åœ¨Aåº”ç”¨ç™»å½•äº†ï¼ŒBåº”ç”¨è¿˜è¦é‡æ–°ç™»å½•
â€¢ æ— é™è·³è½¬ï¼Œæ°¸è¿œç™»å½•ä¸æˆåŠŸ
â€¢ åˆšç™»å½•å°±è¢«è¸¢å‡ºæ¥
â€¢ ä¸åŒæµè§ˆå™¨è¡¨ç°ä¸ä¸€è‡´
```

### 1.2 SSOé—®é¢˜åˆ†ç±»


| é—®é¢˜ç±»å‹ | **è¡¨ç°ç—‡çŠ¶** | **å½±å“èŒƒå›´** | **ç´§æ€¥ç¨‹åº¦** |
|---------|------------|-------------|-------------|
| ğŸ”„ **æ­»å¾ªç¯è·³è½¬** | `é¡µé¢ä¸åœè·³è½¬ï¼Œæ— æ³•å®Œæˆç™»å½•` | `å½±å“æ‰€æœ‰ç”¨æˆ·` | `âš ï¸ é«˜` |
| ğŸ« **ä»¤ç‰ŒåŒæ­¥é—®é¢˜** | `ç™»å½•çŠ¶æ€ä¸ä¸€è‡´ï¼Œæ—¶æœ‰æ—¶æ— ` | `éƒ¨åˆ†ç”¨æˆ·` | `âš ï¸ ä¸­` |
| ğŸ–¥ï¸ **å…¼å®¹æ€§é—®é¢˜** | `æŸäº›æµè§ˆå™¨æˆ–è®¾å¤‡æ— æ³•ä½¿ç”¨` | `ç‰¹å®šç¯å¢ƒ` | `âš ï¸ ä½` |
| âš–ï¸ **è´Ÿè½½å‡è¡¡é—®é¢˜** | `ç™»å½•åå¶å°”ä¸¢å¤±ä¼šè¯` | `é«˜å¹¶å‘æ—¶` | `âš ï¸ é«˜` |

### 1.3 æ’æŸ¥æ€è·¯æ€»è§ˆ


```
SSOé—®é¢˜æ’æŸ¥çš„"ä¾¦æ¢æ€ç»´"ï¼š

ç¬¬1æ­¥ï¼šç°è±¡è§‚å¯Ÿ
â€¢ ç”¨æˆ·å…·ä½“é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
â€¢ é—®é¢˜æ˜¯å¦èƒ½ç¨³å®šå¤ç°ï¼Ÿ
â€¢ å½±å“èŒƒå›´æœ‰å¤šå¤§ï¼Ÿ

ç¬¬2æ­¥ï¼šç¯å¢ƒåˆ†æ  
â€¢ æµè§ˆå™¨ç‰ˆæœ¬å’Œç±»å‹
â€¢ ç½‘ç»œç¯å¢ƒï¼ˆå…¬å¸å†…ç½‘/å®¶åº­ç½‘ç»œï¼‰
â€¢ è®¾å¤‡ç±»å‹ï¼ˆPC/æ‰‹æœº/å¹³æ¿ï¼‰

ç¬¬3æ­¥ï¼šæ—¥å¿—æŸ¥çœ‹
â€¢ è®¤è¯ä¸­å¿ƒæ—¥å¿—
â€¢ å„åº”ç”¨ç³»ç»Ÿæ—¥å¿—  
â€¢ ç½‘ç»œè¯·æ±‚æ—¥å¿—

ç¬¬4æ­¥ï¼šå·¥å…·è¾…åŠ©
â€¢ æŠ“åŒ…å·¥å…·çœ‹è¯·æ±‚æµç¨‹
â€¢ æµè§ˆå™¨å¼€å‘è€…å·¥å…·
â€¢ ä¸“ä¸šæµ‹è¯•å·¥å…·
```

---

## 2. ğŸ”„ ç™»å½•è·³è½¬æ­»å¾ªç¯é—®é¢˜


### 2.1 æ­»å¾ªç¯é—®é¢˜çš„è¡¨ç°


**ğŸ­ ç”¨æˆ·çœ‹åˆ°çš„ç°è±¡**
```
ç”¨æˆ·ä½“éªŒï¼š
1. ç‚¹å‡»ç™»å½•æŒ‰é’®
2. é¡µé¢è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒ
3. è®¤è¯ä¸­å¿ƒåˆè·³å›åŸåº”ç”¨
4. åŸåº”ç”¨å‘ç°ç”¨æˆ·æœªç™»å½•ï¼Œåˆè·³è½¬åˆ°è®¤è¯ä¸­å¿ƒ
5. æ— é™å¾ªç¯ï¼Œæ°¸è¿œç™»å½•ä¸æˆåŠŸ

å°±åƒä¸¤ä¸ªé—¨å«äº’ç›¸æ¨è¯¿ï¼š
é—¨å«Aï¼š"ä½ å»æ‰¾é—¨å«Bç™»è®°"
é—¨å«Bï¼š"ä½ å»æ‰¾é—¨å«Aç™»è®°"
ç”¨æˆ·åœ¨ä¸¤ä¸ªé—¨å«ä¹‹é—´æ— é™è·‘è…¿
```

### 2.2 æ­»å¾ªç¯çš„å¸¸è§åŸå› 


**ğŸ”¸ åŸå› 1ï¼šå›è°ƒåœ°å€é…ç½®é”™è¯¯**
```
é”™è¯¯é…ç½®ç¤ºä¾‹ï¼š

è®¤è¯ä¸­å¿ƒé…ç½®ï¼š
redirect_uri: http://app.com/login    âŒ é”™è¯¯

åº”ç”¨ç³»ç»Ÿé…ç½®ï¼š
login_url: http://sso.com/login       

é—®é¢˜åˆ†æï¼š
â€¢ è®¤è¯æˆåŠŸåè·³å› /login é¡µé¢
â€¢ /login é¡µé¢æ£€æµ‹åˆ°ç”¨æˆ·æœªç™»å½•çŠ¶æ€
â€¢ åˆé‡æ–°å‘èµ·ç™»å½•è·³è½¬
â€¢ å½¢æˆæ­»å¾ªç¯

æ­£ç¡®é…ç½®ï¼š
redirect_uri: http://app.com/callback  âœ… æ­£ç¡®
```

**ğŸ”¸ åŸå› 2ï¼šSessionçŠ¶æ€åˆ¤æ–­é”™è¯¯**
```java
// é”™è¯¯çš„ç™»å½•æ£€æŸ¥é€»è¾‘
@GetMapping("/callback")
public String callback(String token) {
    // âŒ é”™è¯¯ï¼šéªŒè¯tokenåæ²¡æœ‰è®¾ç½®session
    boolean valid = validateToken(token);
    if (valid) {
        // ç›´æ¥è·³è½¬ï¼Œä½†sessionä¸­æ²¡æœ‰ç™»å½•çŠ¶æ€
        return "redirect:/home";
    }
    return "redirect:/login";  // åˆè·³å›ç™»å½•é¡µ
}

// æ­£ç¡®çš„å¤„ç†é€»è¾‘
@GetMapping("/callback")  
public String callback(String token, HttpSession session) {
    boolean valid = validateToken(token);
    if (valid) {
        // âœ… æ­£ç¡®ï¼šè®¾ç½®sessionçŠ¶æ€
        session.setAttribute("user", getUserInfo(token));
        return "redirect:/home";
    }
    return "redirect:/login";
}
```

**ğŸ”¸ åŸå› 3ï¼šCookieåŸŸåè®¾ç½®é—®é¢˜**
```
é—®é¢˜åœºæ™¯ï¼š
ä¸»åŸŸåï¼šcompany.com
SSOæœåŠ¡ï¼šsso.company.com  
åº”ç”¨Aï¼šapp1.company.com
åº”ç”¨Bï¼šapp2.company.com

é”™è¯¯é…ç½®ï¼š
CookieåŸŸåè®¾ç½®ä¸ºï¼šapp1.company.com  âŒ

ç»“æœï¼š
â€¢ sso.company.com æ— æ³•è¯»å–cookie
â€¢ æ¯æ¬¡éƒ½è®¤ä¸ºç”¨æˆ·æœªç™»å½•
â€¢ ä¸æ–­é‡æ–°è®¤è¯

æ­£ç¡®é…ç½®ï¼š  
CookieåŸŸåè®¾ç½®ä¸ºï¼š.company.com    âœ…
```

### 2.3 æ­»å¾ªç¯é—®é¢˜æ’æŸ¥æ­¥éª¤


**ğŸ” æ’æŸ¥æ­¥éª¤**
```
æ­¥éª¤1ï¼šè§‚å¯Ÿè·³è½¬æµç¨‹
â€¢ æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
â€¢ è§‚å¯ŸNetworké¢æ¿çš„è¯·æ±‚
â€¢ è®°å½•æ¯æ¬¡è·³è½¬çš„URLå˜åŒ–

æ­¥éª¤2ï¼šæ£€æŸ¥å›è°ƒé…ç½®
â€¢ ç¡®è®¤redirect_urié…ç½®æ­£ç¡®
â€¢ æ£€æŸ¥å›è°ƒå¤„ç†é€»è¾‘
â€¢ éªŒè¯å‚æ•°ä¼ é€’æ˜¯å¦å®Œæ•´

æ­¥éª¤3ï¼šæ£€æŸ¥Sessionå¤„ç†
â€¢ ç¡®è®¤ç™»å½•æˆåŠŸåè®¾ç½®äº†session
â€¢ æ£€æŸ¥sessionçš„æœ‰æ•ˆæœŸé…ç½®  
â€¢ éªŒè¯cookieçš„åŸŸåå’Œè·¯å¾„è®¾ç½®

æ­¥éª¤4ï¼šæµ‹è¯•ä¿®å¤æ•ˆæœ
â€¢ æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜å’Œcookie
â€¢ é‡æ–°æµ‹è¯•ç™»å½•æµç¨‹
â€¢ ç¡®è®¤é—®é¢˜æ˜¯å¦è§£å†³
```

### 2.4 é¢„é˜²æ­»å¾ªç¯çš„æœ€ä½³å®è·µ


**ğŸ’¡ é¢„é˜²æªæ–½**
```
è®¾è®¡åŸåˆ™ï¼š
â€¢ ç™»å½•é¡µé¢å’Œå›è°ƒé¡µé¢è¦åˆ†ç¦»
â€¢ å›è°ƒé¡µé¢åªå¤„ç†è®¤è¯ç»“æœï¼Œä¸åšå…¶ä»–åˆ¤æ–­
â€¢ è®¾ç½®åˆç†çš„è·³è½¬æ¬¡æ•°é™åˆ¶

ä»£ç è§„èŒƒï¼š
â€¢ ç»Ÿä¸€çš„sessionçŠ¶æ€ç®¡ç†
â€¢ æ ‡å‡†åŒ–çš„é”™è¯¯å¤„ç†æµç¨‹  
â€¢ è¯¦ç»†çš„æ—¥å¿—è®°å½•

æµ‹è¯•æ£€æŸ¥ï¼š
â€¢ å¤šè½®è·³è½¬æµ‹è¯•
â€¢ å¼‚å¸¸æƒ…å†µæ¨¡æ‹Ÿ
â€¢ ä¸åŒæµè§ˆå™¨éªŒè¯
```

---

## 3. ğŸ« Tokenå¤±æ•ˆä½†SessionæœªåŒæ­¥


### 3.1 é—®é¢˜ç°è±¡æè¿°


**ğŸ­ ç”¨æˆ·é‡åˆ°çš„æƒ…å†µ**
```
å…¸å‹åœºæ™¯ï¼š
1. ç”¨æˆ·åœ¨åº”ç”¨Aæ­£å¸¸ä½¿ç”¨ï¼ˆsessionæœ‰æ•ˆï¼‰
2. ä½†å®é™…ä¸ŠSSOä¸­å¿ƒçš„tokenå·²ç»è¿‡æœŸ
3. ç”¨æˆ·è®¿é—®åº”ç”¨Bæ—¶ï¼Œå‘ç°éœ€è¦é‡æ–°ç™»å½•
4. ç”¨æˆ·æ„Ÿåˆ°å›°æƒ‘ï¼š"æˆ‘æ˜æ˜è¿˜åœ¨ä½¿ç”¨ç³»ç»Ÿå•Š"

å°±åƒä¼šå‘˜å¡çš„ä¾‹å­ï¼š
â€¢ ä½ çš„ä¼šå‘˜å¡(token)å·²ç»è¿‡æœŸäº†
â€¢ ä½†ä½ è¿˜æ‹¿ç€è´­ç‰©è½¦(session)åœ¨å•†åº—é‡Œ
â€¢ å»æ”¶é“¶å°ç»“è´¦æ—¶æ‰å‘ç°å¡ç‰‡æ— æ•ˆ
```

### 3.2 é—®é¢˜äº§ç”Ÿçš„åŸç†


**ğŸ”¸ æ—¶é—´å·®å¼‚å¯¼è‡´çš„åŒæ­¥é—®é¢˜**
```
æ—¶é—´è½´åˆ†æï¼š

09:00  ç”¨æˆ·ç™»å½•ï¼Œè·å¾—tokenï¼ˆæœ‰æ•ˆæœŸ2å°æ—¶ï¼‰
10:30  ç”¨æˆ·åœ¨åº”ç”¨Aå·¥ä½œï¼ˆsessionå»¶é•¿åˆ°12:30ï¼‰
11:00  SSOä¸­å¿ƒtokenè¿‡æœŸï¼ˆä½†åº”ç”¨Aä¸çŸ¥é“ï¼‰
11:30  ç”¨æˆ·è®¿é—®åº”ç”¨Bï¼Œå‘ç°éœ€è¦é‡æ–°ç™»å½•

é—®é¢˜æ ¹æºï¼š
â€¢ Tokenè¿‡æœŸæ—¶é—´ï¼š2å°æ—¶ï¼ˆSSOä¸­å¿ƒæ§åˆ¶ï¼‰
â€¢ Sessionè¿‡æœŸæ—¶é—´ï¼š4å°æ—¶ï¼ˆåº”ç”¨è‡ªå·±æ§åˆ¶ï¼‰
â€¢ ä¸¤ä¸ªæ—¶é—´ä¸åŒæ­¥ï¼Œå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´
```

**ğŸ”¸ ç³»ç»Ÿæ¶æ„å›¾ç¤º**
```
ç”¨æˆ·æµè§ˆå™¨
    |
    |-- Session A (12:30è¿‡æœŸ)
    |-- Session B (æœªç™»å½•)
    |-- SSO Token (11:00å·²è¿‡æœŸ)
    |
SSOè®¤è¯ä¸­å¿ƒ (Tokenå·²å¤±æ•ˆ)
```

### 3.3 å¸¸è§çš„ä¸åŒæ­¥åœºæ™¯


**ğŸ“ åœºæ™¯1ï¼šTokenè¿‡æœŸä½†Sessionæœªè¿‡æœŸ**
```java
// åº”ç”¨Açš„æ£€æŸ¥é€»è¾‘ï¼ˆæœ‰é—®é¢˜çš„ç‰ˆæœ¬ï¼‰
@GetMapping("/api/data")
public ResponseEntity getData(HttpSession session) {
    // åªæ£€æŸ¥æœ¬åœ°sessionï¼Œä¸éªŒè¯SSO token
    if (session.getAttribute("user") != null) {
        return ResponseEntity.ok(data);  // âŒ å¯èƒ½tokenå·²è¿‡æœŸ
    }
    return ResponseEntity.status(401).build();
}

// æ”¹è¿›ç‰ˆæœ¬
@GetMapping("/api/data")  
public ResponseEntity getData(HttpSession session) {
    if (session.getAttribute("user") != null) {
        // âœ… åŒæ—¶éªŒè¯SSO tokenæ˜¯å¦æœ‰æ•ˆ
        if (validateSSOToken()) {
            return ResponseEntity.ok(data);
        } else {
            // tokenè¿‡æœŸï¼Œæ¸…é™¤æœ¬åœ°session
            session.invalidate();
        }
    }
    return ResponseEntity.status(401).build();
}
```

**ğŸ“ åœºæ™¯2ï¼šå¼ºåˆ¶é€€å‡ºæœªé€šçŸ¥æ‰€æœ‰åº”ç”¨**
```
é—®é¢˜æµç¨‹ï¼š
1. ç®¡ç†å‘˜åœ¨SSOä¸­å¿ƒå¼ºåˆ¶ç”¨æˆ·ä¸‹çº¿
2. SSOä¸­å¿ƒtokenç«‹å³å¤±æ•ˆ
3. ä½†å„åº”ç”¨çš„sessionä»ç„¶æœ‰æ•ˆ
4. ç”¨æˆ·åœ¨å·²ç™»å½•çš„åº”ç”¨ä¸­å¯ä»¥ç»§ç»­æ“ä½œ

è§£å†³æ–¹æ¡ˆï¼š
â€¢ å®ç°å…¨å±€é€€å‡ºé€šçŸ¥æœºåˆ¶
â€¢ å„åº”ç”¨å®šæœŸéªŒè¯tokenæœ‰æ•ˆæ€§  
â€¢ ä½¿ç”¨Redisç­‰å…±äº«å­˜å‚¨åŒæ­¥çŠ¶æ€
```

### 3.4 è§£å†³Tokenä¸SessionåŒæ­¥é—®é¢˜


**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ1ï¼šå®šæœŸTokenéªŒè¯**
```java
// æ‹¦æˆªå™¨å®ç°å®šæœŸéªŒè¯
@Component
public class SSOTokenInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        HttpSession session = request.getSession();
        String token = (String) session.getAttribute("sso_token");
        
        if (token != null) {
            // æ¯10åˆ†é’ŸéªŒè¯ä¸€æ¬¡token
            Long lastCheck = (Long) session.getAttribute("last_token_check");
            if (lastCheck == null || 
                System.currentTimeMillis() - lastCheck > 10 * 60 * 1000) {
                
                if (!validateTokenWithSSO(token)) {
                    // tokenå¤±æ•ˆï¼Œæ¸…é™¤session
                    session.invalidate();
                    response.sendRedirect("/login");
                    return false;
                }
                
                session.setAttribute("last_token_check", 
                                   System.currentTimeMillis());
            }
        }
        
        return true;
    }
}
```

**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨å¿ƒè·³æ£€æµ‹**
```javascript
// å‰ç«¯å®šæœŸæ£€æŸ¥ç™»å½•çŠ¶æ€
function checkLoginStatus() {
    fetch('/api/check-auth')
        .then(response => {
            if (response.status === 401) {
                // ç™»å½•çŠ¶æ€å¤±æ•ˆï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
                window.location.href = '/login';
            }
        })
        .catch(error => {
            console.log('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
        });
}

// æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
setInterval(checkLoginStatus, 5 * 60 * 1000);
```

### 3.5 æœ€ä½³å®è·µå»ºè®®


**ğŸ’¡ åŒæ­¥ç­–ç•¥**
```
æ—¶é—´é…ç½®åŸåˆ™ï¼š
â€¢ Tokenæœ‰æ•ˆæœŸåº”è¯¥ç•¥é•¿äºSessionæœ‰æ•ˆæœŸ
â€¢ æˆ–è€…ä¸¤è€…ä¿æŒä¸€è‡´
â€¢ é¿å…å‡ºç°æ—¶é—´å€’æŒ‚

å®ç°å»ºè®®ï¼š
â€¢ ç»Ÿä¸€ä½¿ç”¨JWT tokenï¼ŒåŒ…å«è¿‡æœŸæ—¶é—´
â€¢ åœ¨tokenå¿«è¿‡æœŸæ—¶è‡ªåŠ¨ç»­æœŸ
â€¢ å®ç°å…¨å±€ç™»å‡ºé€šçŸ¥æœºåˆ¶

ç›‘æ§è¦ç‚¹ï¼š
â€¢ ç›‘æ§tokenå’Œsessionçš„ä¸ä¸€è‡´æƒ…å†µ
â€¢ è®°å½•ç”¨æˆ·çš„å¼‚å¸¸ç™»å‡ºäº‹ä»¶
â€¢ å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¶é—´åŒæ­¥
```

---

## 4. ğŸ–¥ï¸ å¤šæµè§ˆå™¨å¤šè®¾å¤‡å…¼å®¹é—®é¢˜


### 4.1 å…¼å®¹é—®é¢˜çš„è¡¨ç°


**ğŸ­ ç”¨æˆ·å¸¸è§å›°æ‰°**
```
åœºæ™¯æè¿°ï¼š
â€¢ Chromeæµè§ˆå™¨ç™»å½•æ­£å¸¸ï¼ŒIEæµè§ˆå™¨ç™»å½•å¤±è´¥
â€¢ æ‰‹æœºä¸Šå¯ä»¥ç™»å½•ï¼Œç”µè„‘ä¸Šä¸èƒ½ç™»å½•  
â€¢ å®¶é‡Œçš„ç½‘ç»œæ­£å¸¸ï¼Œå…¬å¸ç½‘ç»œæœ‰é—®é¢˜

å°±åƒé’¥åŒ™å’Œé”çš„å…³ç³»ï¼š
â€¢ æœ‰çš„é’¥åŒ™(æµè§ˆå™¨)èƒ½å¼€é”(SSOç³»ç»Ÿ)
â€¢ æœ‰çš„é’¥åŒ™å½¢çŠ¶ä¸å¯¹ï¼Œæ’ä¸è¿›å»
â€¢ æœ‰çš„é”èŠ¯(ç½‘ç»œç¯å¢ƒ)è¢«æ”¹é€ è¿‡ï¼ŒåŸé’¥åŒ™ä¸å¥½ä½¿
```

### 4.2 æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜


**ğŸ”¸ Cookieå¤„ç†å·®å¼‚**
```
é—®é¢˜è¡¨ç°ï¼š
ä¸åŒæµè§ˆå™¨å¯¹Cookieçš„å¤„ç†ç­–ç•¥ä¸åŒ

Chromeæµè§ˆå™¨ï¼š
â€¢ ä¸¥æ ¼æŒ‰ç…§Same-Siteç­–ç•¥
â€¢ å¯¹ç¬¬ä¸‰æ–¹Cookieé™åˆ¶è¾ƒä¸¥
â€¢ è¦æ±‚HTTPSç¯å¢ƒä¸‹çš„Secureæ ‡è®°

IEæµè§ˆå™¨ï¼š  
â€¢ å¯¹CookieåŸŸåéªŒè¯è¾ƒå®½æ¾
â€¢ ä¸å®Œå…¨æ”¯æŒHTTPOnlyå±æ€§
â€¢ ç¼“å­˜ç­–ç•¥ç›¸å¯¹æ¿€è¿›

Safariæµè§ˆå™¨ï¼š
â€¢ å¯¹è·¨åŸŸCookieé™åˆ¶æœ€ä¸¥æ ¼
â€¢ é»˜è®¤é˜»æ­¢ç¬¬ä¸‰æ–¹Cookie
â€¢ éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½è®¾ç½®Cookie
```

**ğŸ› ï¸ å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ**
```javascript
// é€šç”¨çš„Cookieè®¾ç½®æ–¹æ³•
function setCompatibleCookie(name, value, options) {
    let cookieStr = `${name}=${value}`;
    
    // è®¾ç½®åŸŸåï¼ˆå…¼å®¹å­åŸŸåï¼‰
    if (options.domain) {
        cookieStr += `; Domain=${options.domain}`;
    }
    
    // è®¾ç½®è·¯å¾„
    cookieStr += `; Path=${options.path || '/'}`;
    
    // è®¾ç½®è¿‡æœŸæ—¶é—´
    if (options.expires) {
        cookieStr += `; Expires=${options.expires.toUTCString()}`;
    }
    
    // å®‰å…¨è®¾ç½®ï¼ˆHTTPSç¯å¢ƒï¼‰
    if (location.protocol === 'https:') {
        cookieStr += '; Secure';
    }
    
    // é˜²æ­¢XSSæ”»å‡»
    cookieStr += '; HttpOnly';
    
    // è·¨ç«™è¯·æ±‚è®¾ç½®ï¼ˆç°ä»£æµè§ˆå™¨ï¼‰
    if (options.sameSite) {
        cookieStr += `; SameSite=${options.sameSite}`;
    }
    
    document.cookie = cookieStr;
}
```

**ğŸ”¸ JavaScriptå…¼å®¹æ€§**
```javascript
// å…¼å®¹ä¸åŒæµè§ˆå™¨çš„URLå‚æ•°è§£æ
function getUrlParameter(name) {
    // ç°ä»£æµè§ˆå™¨æ–¹æ³•
    if (window.URLSearchParams) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }
    
    // å…¼å®¹è€ç‰ˆæœ¬æµè§ˆå™¨
    const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
    const results = regex.exec(window.location.href);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

// å…¼å®¹ä¸åŒæµè§ˆå™¨çš„Ajaxè¯·æ±‚
function makeCompatibleRequest(url, options) {
    // ç°ä»£æµè§ˆå™¨ä½¿ç”¨fetch
    if (window.fetch) {
        return fetch(url, options);
    }
    
    // è€ç‰ˆæœ¬æµè§ˆå™¨ä½¿ç”¨XMLHttpRequest
    return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open(options.method || 'GET', url);
        
        // è®¾ç½®è¯·æ±‚å¤´
        if (options.headers) {
            Object.keys(options.headers).forEach(key => {
                xhr.setRequestHeader(key, options.headers[key]);
            });
        }
        
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status >= 200 && xhr.status < 300) {
                    resolve({
                        ok: true,
                        status: xhr.status,
                        json: () => Promise.resolve(JSON.parse(xhr.responseText))
                    });
                } else {
                    reject(new Error(`HTTP ${xhr.status}`));
                }
            }
        };
        
        xhr.send(options.body);
    });
}
```

### 4.3 ç§»åŠ¨è®¾å¤‡å…¼å®¹é—®é¢˜


**ğŸ“± ç§»åŠ¨ç«¯ç‰¹æ®Šè€ƒè™‘**
```
iOSè®¾å¤‡ç‰¹ç‚¹ï¼š
â€¢ Safariæµè§ˆå™¨çš„Cookieç­–ç•¥ä¸¥æ ¼
â€¢ Appå†…åµŒWebViewä¸Safariè¡Œä¸ºä¸åŒ
â€¢ éœ€è¦è€ƒè™‘Appåˆ‡æ¢æ—¶çš„çŠ¶æ€ä¿æŒ

Androidè®¾å¤‡ç‰¹ç‚¹ï¼š
â€¢ ä¸åŒå‚å•†çš„æµè§ˆå™¨è¡Œä¸ºå·®å¼‚å¤§
â€¢ ç³»ç»ŸWebViewç‰ˆæœ¬å¯èƒ½è¾ƒæ—§
â€¢ å†…å­˜é™åˆ¶å¯èƒ½å¯¼è‡´é¡µé¢é‡æ–°åŠ è½½

é€šç”¨ç§»åŠ¨ç«¯é—®é¢˜ï¼š
â€¢ ç½‘ç»œä¸ç¨³å®šï¼Œéœ€è¦å¤„ç†æ–­çº¿é‡è¿
â€¢ å±å¹•å°ºå¯¸å°ï¼Œäº¤äº’ä½“éªŒè¦ä¼˜åŒ–
â€¢ è§¦æ‘¸æ“ä½œä¸é¼ æ ‡æ“ä½œçš„å·®å¼‚
```

**ğŸ› ï¸ ç§»åŠ¨ç«¯é€‚é…æ–¹æ¡ˆ**
```javascript
// æ£€æµ‹è®¾å¤‡ç±»å‹
function detectDevice() {
    const userAgent = navigator.userAgent;
    
    return {
        isMobile: /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent),
        isIOS: /iPad|iPhone|iPod/.test(userAgent),
        isAndroid: /Android/.test(userAgent),
        isSafari: /Safari/.test(userAgent) && !/Chrome/.test(userAgent),
        isWeChat: /MicroMessenger/i.test(userAgent)
    };
}

// ç§»åŠ¨ç«¯ç™»å½•é€‚é…
function mobileLogin() {
    const device = detectDevice();
    
    if (device.isMobile) {
        // ç§»åŠ¨ç«¯ä½¿ç”¨å¼¹çª—ç™»å½•ï¼Œé¿å…é¡µé¢è·³è½¬
        showMobileLoginModal();
    } else {
        // æ¡Œé¢ç«¯å¯ä»¥ä½¿ç”¨é¡µé¢è·³è½¬
        window.location.href = '/login';
    }
}

// å¤„ç†Appå†…åµŒWebViewçš„ç™»å½•
function handleAppWebViewLogin() {
    // æ£€æŸ¥æ˜¯å¦åœ¨Appå†…
    if (window.isInApp || device.isWeChat) {
        // ä½¿ç”¨Appæä¾›çš„ç™»å½•æ¥å£
        if (window.appLogin) {
            window.appLogin();
        } else {
            // é™çº§å¤„ç†ï¼Œä½¿ç”¨æ™®é€šç™»å½•
            normalLogin();
        }
    }
}
```

### 4.4 ç½‘ç»œç¯å¢ƒå…¼å®¹é—®é¢˜


**ğŸŒ å¸¸è§ç½‘ç»œç¯å¢ƒé—®é¢˜**
```
ä¼ä¸šå†…ç½‘ç¯å¢ƒï¼š
â€¢ ä»£ç†æœåŠ¡å™¨å¯èƒ½ä¿®æ”¹è¯·æ±‚å¤´
â€¢ é˜²ç«å¢™å¯èƒ½é˜»æ­¢æŸäº›ç«¯å£
â€¢ SSLè¯ä¹¦å¯èƒ½è¢«ä¼ä¸šCAæ›¿æ¢

å…¬å…±WiFiç¯å¢ƒï¼š
â€¢ å¯èƒ½å­˜åœ¨å¼ºåˆ¶è®¤è¯é¡µé¢  
â€¢ ç½‘ç»œä¸ç¨³å®šï¼Œè¯·æ±‚å¯èƒ½è¶…æ—¶
â€¢ DNSè§£æå¯èƒ½è¢«åŠ«æŒ

ç§»åŠ¨ç½‘ç»œç¯å¢ƒï¼š
â€¢ 4G/5Gç½‘ç»œå»¶è¿Ÿè¾ƒé«˜
â€¢ ç½‘ç»œåˆ‡æ¢å¯èƒ½å¯¼è‡´è¿æ¥ä¸­æ–­
â€¢ æµé‡é™åˆ¶å¯èƒ½å½±å“å¤§æ–‡ä»¶ä¼ è¾“
```

**ğŸ› ï¸ ç½‘ç»œé€‚é…è§£å†³æ–¹æ¡ˆ**
```javascript
// ç½‘ç»œçŠ¶æ€æ£€æµ‹
function checkNetworkStatus() {
    // æ£€æµ‹åœ¨çº¿çŠ¶æ€
    if (!navigator.onLine) {
        showOfflineMessage();
        return false;
    }
    
    // æ£€æµ‹ç½‘ç»œé€Ÿåº¦
    const connection = navigator.connection || 
                      navigator.mozConnection || 
                      navigator.webkitConnection;
    
    if (connection) {
        const isSlowNetwork = connection.effectiveType === 'slow-2g' || 
                             connection.effectiveType === '2g';
        
        if (isSlowNetwork) {
            // æ…¢ç½‘ç»œä¼˜åŒ–
            enableSlowNetworkMode();
        }
    }
    
    return true;
}

// è¯·æ±‚é‡è¯•æœºåˆ¶
function requestWithRetry(url, options, maxRetries = 3) {
    let retryCount = 0;
    
    function attemptRequest() {
        return makeCompatibleRequest(url, options)
            .catch(error => {
                retryCount++;
                if (retryCount <= maxRetries) {
                    // æŒ‡æ•°é€€é¿é‡è¯•
                    const delay = Math.pow(2, retryCount) * 1000;
                    return new Promise(resolve => {
                        setTimeout(() => resolve(attemptRequest()), delay);
                    });
                } else {
                    throw error;
                }
            });
    }
    
    return attemptRequest();
}
```

### 4.5 å…¼å®¹æ€§æµ‹è¯•å»ºè®®


**ğŸ§ª æµ‹è¯•ç­–ç•¥**
```
æµè§ˆå™¨æµ‹è¯•çŸ©é˜µï¼š
âœ… Chrome (æœ€æ–°ç‰ˆæœ¬ + å‰ä¸¤ä¸ªç‰ˆæœ¬)
âœ… Firefox (æœ€æ–°ç‰ˆæœ¬ + å‰ä¸€ä¸ªç‰ˆæœ¬)  
âœ… Safari (æœ€æ–°ç‰ˆæœ¬)
âœ… Edge (æœ€æ–°ç‰ˆæœ¬)
âœ… IE11 (å¦‚æœéœ€è¦æ”¯æŒ)

ç§»åŠ¨è®¾å¤‡æµ‹è¯•ï¼š
âœ… iOS Safari (æœ€æ–°ç³»ç»Ÿ)
âœ… Android Chrome (ä¸»æµç‰ˆæœ¬)
âœ… å¾®ä¿¡å†…ç½®æµè§ˆå™¨
âœ… ä¸»æµAppå†…åµŒWebView

ç½‘ç»œç¯å¢ƒæµ‹è¯•ï¼š
âœ… ä¼ä¸šå†…ç½‘ç¯å¢ƒ
âœ… å®¶åº­å®½å¸¦ç¯å¢ƒ  
âœ… ç§»åŠ¨ç½‘ç»œç¯å¢ƒ
âœ… ä»£ç†æœåŠ¡å™¨ç¯å¢ƒ
```

---

## 5. âš–ï¸ è´Ÿè½½å‡è¡¡å¯¼è‡´çš„ä¼šè¯ä¸¢å¤±


### 5.1 è´Ÿè½½å‡è¡¡ä¼šè¯é—®é¢˜åŸç†


**ğŸ­ é—®é¢˜åœºæ™¯æè¿°**
```
ç”¨æˆ·ä½“éªŒï¼š
1. ç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥è´¦å·å¯†ç 
2. è´Ÿè½½å‡è¡¡å™¨å°†è¯·æ±‚åˆ†å‘åˆ°æœåŠ¡å™¨A
3. æœåŠ¡å™¨AéªŒè¯æˆåŠŸï¼Œåˆ›å»ºsession
4. ç”¨æˆ·ç‚¹å‡»é¡µé¢é“¾æ¥ï¼Œè´Ÿè½½å‡è¡¡å™¨å°†è¯·æ±‚åˆ†å‘åˆ°æœåŠ¡å™¨B  
5. æœåŠ¡å™¨Bæ‰¾ä¸åˆ°sessionï¼Œè¦æ±‚ç”¨æˆ·é‡æ–°ç™»å½•

å°±åƒé…’åº—çš„ä¾‹å­ï¼š
â€¢ ä½ åœ¨å‰å°AåŠç†å…¥ä½ï¼Œæ‹¿åˆ°æˆ¿å¡
â€¢ ä½†ä½ è¢«å¸¦åˆ°äº†æ¥¼å±‚Bï¼Œé‚£é‡Œçš„æœåŠ¡å‘˜ä¸è®¤è¯†ä½ 
â€¢ å› ä¸ºä¸¤ä¸ªæœåŠ¡å°æ²¡æœ‰å…±äº«å®¢äººä¿¡æ¯
```

**ğŸ“Š è´Ÿè½½å‡è¡¡æ¶æ„å›¾ç¤º**
```
                ç”¨æˆ·è¯·æ±‚
                    |
            [è´Ÿè½½å‡è¡¡å™¨]
               /       \
          æœåŠ¡å™¨A     æœåŠ¡å™¨B
         (æœ‰session)  (æ— session)
              |          |
         [æœ¬åœ°å­˜å‚¨]  [æœ¬åœ°å­˜å‚¨]
         ç”¨æˆ·ä¼šè¯     (ç©º)
```

### 5.2 ä¼šè¯ä¸¢å¤±çš„å¸¸è§åŸå› 


**ğŸ”¸ åŸå› 1ï¼šä¼šè¯ç²˜æ€§æœªé…ç½®**
```
é—®é¢˜ï¼šè´Ÿè½½å‡è¡¡å™¨éšæœºåˆ†å‘è¯·æ±‚

Nginxé…ç½®ç¤ºä¾‹ï¼š
# âŒ é”™è¯¯é…ç½®ï¼šå®Œå…¨éšæœºåˆ†å‘
upstream backend {
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

# âœ… æ­£ç¡®é…ç½®ï¼šåŸºäºIPçš„ä¼šè¯ç²˜æ€§
upstream backend {
    ip_hash;  # ç›¸åŒIPæ€»æ˜¯åˆ†å‘åˆ°åŒä¸€å°æœåŠ¡å™¨
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;  
    server 192.168.1.12:8080;
}
```

**ğŸ”¸ åŸå› 2ï¼šä¼šè¯å­˜å‚¨åœ¨æœ¬åœ°å†…å­˜**
```java
// âŒ é”™è¯¯æ–¹å¼ï¼šä½¿ç”¨æœ¬åœ°å†…å­˜å­˜å‚¨session
@Controller
public class LoginController {
    // æœ¬åœ°Mapå­˜å‚¨ï¼Œå…¶ä»–æœåŠ¡å™¨æ— æ³•è®¿é—®
    private Map<String, UserSession> localSessions = new HashMap<>();
    
    @PostMapping("/login")
    public String login(String username, String sessionId) {
        UserSession session = new UserSession(username);
        localSessions.put(sessionId, session);  // åªåœ¨å½“å‰æœåŠ¡å™¨æœ‰æ•ˆ
        return "success";
    }
}

// âœ… æ­£ç¡®æ–¹å¼ï¼šä½¿ç”¨å…±äº«å­˜å‚¨
@Controller  
public class LoginController {
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @PostMapping("/login")
    public String login(String username, String sessionId) {
        UserSession session = new UserSession(username);
        // å­˜å‚¨åˆ°Redisï¼Œæ‰€æœ‰æœåŠ¡å™¨éƒ½èƒ½è®¿é—®
        redisTemplate.opsForValue().set("session:" + sessionId, session, 
                                       Duration.ofHours(2));
        return "success";
    }
}
```

**ğŸ”¸ åŸå› 3ï¼šæœåŠ¡å™¨é‡å¯å¯¼è‡´ä¼šè¯ä¸¢å¤±**
```
é—®é¢˜åœºæ™¯ï¼š
â€¢ æœåŠ¡å™¨Aå­˜å‚¨äº†100ä¸ªç”¨æˆ·ä¼šè¯
â€¢ æœåŠ¡å™¨Aéœ€è¦é‡å¯æ›´æ–°ç³»ç»Ÿ
â€¢ é‡å¯åï¼Œè¿™100ä¸ªç”¨æˆ·çš„ä¼šè¯å…¨éƒ¨ä¸¢å¤±
â€¢ ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•

å½±å“ï¼š
â€¢ ç”¨æˆ·ä½“éªŒå·®
â€¢ ç³»ç»Ÿå¯ç”¨æ€§é™ä½
â€¢ å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
```

### 5.3 ä¼šè¯å…±äº«è§£å†³æ–¹æ¡ˆ


**ğŸ› ï¸ æ–¹æ¡ˆ1ï¼šRedisé›†ä¸­å¼ä¼šè¯å­˜å‚¨**
```java
// Spring Session + Redisé…ç½®
@Configuration
@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 7200)
public class SessionConfig {
    
    @Bean
    public RedisConnectionFactory connectionFactory() {
        LettuceConnectionFactory factory = new LettuceConnectionFactory();
        factory.setHostName("redis-server");
        factory.setPort(6379);
        return factory;
    }
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate() {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(connectionFactory());
        
        // ä½¿ç”¨Jacksonåºåˆ—åŒ–
        Jackson2JsonRedisSerializer<Object> serializer = 
            new Jackson2JsonRedisSerializer<>(Object.class);
        template.setDefaultSerializer(serializer);
        
        return template;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
@RestController
public class UserController {
    
    @GetMapping("/user-info")
    public ResponseEntity<UserInfo> getUserInfo(HttpSession session) {
        // sessionè‡ªåŠ¨å­˜å‚¨åˆ°Redisï¼Œæ‰€æœ‰æœåŠ¡å™¨å…±äº«
        UserInfo user = (UserInfo) session.getAttribute("user");
        if (user != null) {
            return ResponseEntity.ok(user);
        }
        return ResponseEntity.status(401).build();
    }
    
    @PostMapping("/login")  
    public ResponseEntity<String> login(@RequestBody LoginRequest request,
                                      HttpSession session) {
        // éªŒè¯ç”¨æˆ·
        if (validateUser(request)) {
            UserInfo user = getUserInfo(request.getUsername());
            // ä¼šè¯ä¿¡æ¯è‡ªåŠ¨åŒæ­¥åˆ°Redis
            session.setAttribute("user", user);
            return ResponseEntity.ok("ç™»å½•æˆåŠŸ");
        }
        return ResponseEntity.status(401).body("ç™»å½•å¤±è´¥");
    }
}
```

**ğŸ› ï¸ æ–¹æ¡ˆ2ï¼šJWTæ— çŠ¶æ€è®¤è¯**
```java
// JWTå·¥å…·ç±»
@Component
public class JwtUtil {
    private String secret = "mySecretKey";
    private int expiration = 7200; // 2å°æ—¶
    
    // ç”ŸæˆJWT token
    public String generateToken(UserInfo user) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("username", user.getUsername());
        claims.put("roles", user.getRoles());
        claims.put("userId", user.getId());
        
        return Jwts.builder()
                .setClaims(claims)
                .setSubject(user.getUsername())
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + expiration * 1000))
                .signWith(SignatureAlgorithm.HS512, secret)
                .compact();
    }
    
    // éªŒè¯JWT token
    public UserInfo validateToken(String token) {
        try {
            Claims claims = Jwts.parser()
                    .setSigningKey(secret)
                    .parseClaimsJws(token)
                    .getBody();
                    
            UserInfo user = new UserInfo();
            user.setUsername(claims.getSubject());
            user.setId((Integer) claims.get("userId"));
            user.setRoles((List<String>) claims.get("roles"));
            
            return user;
        } catch (Exception e) {
            return null; // tokenæ— æ•ˆ
        }
    }
}

// ä½¿ç”¨JWTçš„æ§åˆ¶å™¨
@RestController
public class JwtController {
    @Autowired
    private JwtUtil jwtUtil;
    
    @PostMapping("/jwt-login")
    public ResponseEntity<Map<String, String>> login(
            @RequestBody LoginRequest request) {
        if (validateUser(request)) {
            UserInfo user = getUserInfo(request.getUsername());
            String token = jwtUtil.generateToken(user);
            
            Map<String, String> response = new HashMap<>();
            response.put("token", token);
            response.put("message", "ç™»å½•æˆåŠŸ");
            
            return ResponseEntity.ok(response);
        }
        return ResponseEntity.status(401).build();
    }
    
    @GetMapping("/jwt-user-info")
    public ResponseEntity<UserInfo> getUserInfo(
            @RequestHeader("Authorization") String authHeader) {
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            String token = authHeader.substring(7);
            UserInfo user = jwtUtil.validateToken(token);
            if (user != null) {
                return ResponseEntity.ok(user);
            }
        }
        return ResponseEntity.status(401).build();
    }
}
```

### 5.4 è´Ÿè½½å‡è¡¡é…ç½®ä¼˜åŒ–


**ğŸ”§ Nginxè´Ÿè½½å‡è¡¡é…ç½®**
```nginx
# å®Œæ•´çš„è´Ÿè½½å‡è¡¡é…ç½®
upstream sso_backend {
    # ä¼šè¯ç²˜æ€§ç­–ç•¥
    ip_hash;  # åŸºäºå®¢æˆ·ç«¯IP
    # æˆ–è€…ä½¿ç”¨: hash $cookie_jsessionid consistent; # åŸºäºsession cookie
    
    # æœåŠ¡å™¨åˆ—è¡¨
    server 192.168.1.10:8080 weight=3 max_fails=2 fail_timeout=30s;
    server 192.168.1.11:8080 weight=2 max_fails=2 fail_timeout=30s;  
    server 192.168.1.12:8080 weight=1 max_fails=2 fail_timeout=30s backup;
    
    # å¥åº·æ£€æŸ¥
    keepalive 32;
}

server {
    listen 80;
    server_name sso.example.com;
    
    location / {
        proxy_pass http://sso_backend;
        
        # ä¼ é€’çœŸå®IP
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # ä¼šè¯ä¿æŒç›¸å…³
        proxy_set_header Cookie $http_cookie;
        proxy_cookie_path / "/; HttpOnly; Secure";
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
}
```

### 5.5 ç›‘æ§å’Œæ•…éšœå¤„ç†


**ğŸ“Š ç›‘æ§æŒ‡æ ‡**
```yaml
# ç›‘æ§é…ç½®ç¤ºä¾‹
monitoring:
  session_metrics:
    - name: "session_creation_rate"
      description: "æ¯åˆ†é’Ÿåˆ›å»ºçš„ä¼šè¯æ•°"
      threshold: 1000
      
    - name: "session_loss_rate"  
      description: "ä¼šè¯ä¸¢å¤±ç‡"
      threshold: 0.01  # 1%
      
    - name: "redis_connection_status"
      description: "Redisè¿æ¥çŠ¶æ€"
      critical: true
      
  load_balancer_metrics:
    - name: "backend_response_time"
      description: "åç«¯å“åº”æ—¶é—´"
      threshold: 2000  # 2ç§’
      
    - name: "backend_error_rate"
      description: "åç«¯é”™è¯¯ç‡"  
      threshold: 0.05  # 5%
```

**ğŸš¨ æ•…éšœåº”æ€¥å¤„ç†**
```
ä¼šè¯ä¸¢å¤±æ•…éšœå¤„ç†æµç¨‹ï¼š

1. ç«‹å³ç¡®è®¤èŒƒå›´
   â€¢ æ£€æŸ¥å½±å“çš„ç”¨æˆ·æ•°é‡
   â€¢ ç¡®è®¤æ˜¯å¦å…¨ç«™å½±å“
   â€¢ æ£€æŸ¥ç›‘æ§å‘Šè­¦

2. å¿«é€Ÿå®šä½é—®é¢˜
   â€¢ æ£€æŸ¥Redisè¿æ¥çŠ¶æ€
   â€¢ æ£€æŸ¥è´Ÿè½½å‡è¡¡å™¨é…ç½®
   â€¢ æŸ¥çœ‹åº”ç”¨æœåŠ¡å™¨æ—¥å¿—

3. ä¸´æ—¶ç¼“è§£æªæ–½
   â€¢ å¦‚æœRedisæ•…éšœï¼Œä¸´æ—¶ç¦ç”¨ä¼šè¯ç²˜æ€§
   â€¢ å¦‚æœæœåŠ¡å™¨æ•…éšœï¼Œä»è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤
   â€¢ å¯ç”¨å¤‡ç”¨æœåŠ¡å™¨

4. é•¿æœŸä¿®å¤
   â€¢ ä¿®å¤æ ¹æœ¬åŸå› 
   â€¢ æ›´æ–°ç›‘æ§è§„åˆ™
   â€¢ å®Œå–„æ•…éšœé¢„æ¡ˆ
```

---

## 6. ğŸ”§ è°ƒè¯•å·¥å…·ä¸æŠ“åŒ…åˆ†æ


### 6.1 è°ƒè¯•å·¥å…·æ¦‚è¿°


**ğŸ› ï¸ å·¥å…·åˆ†ç±»å’Œç”¨é€”**
```
æµè§ˆå™¨å†…ç½®å·¥å…·ï¼š
â€¢ Chrome DevTools - ç½‘ç»œè¯·æ±‚ã€Cookieã€å­˜å‚¨
â€¢ Firefox Developer Tools - ç±»ä¼¼åŠŸèƒ½
â€¢ Safari Web Inspector - Mac/iOSè°ƒè¯•

ä¸“ä¸šæŠ“åŒ…å·¥å…·ï¼š
â€¢ Fiddler - Windowså¹³å°ï¼ŒåŠŸèƒ½å¼ºå¤§
â€¢ Charles Proxy - è·¨å¹³å°ï¼Œç•Œé¢å‹å¥½  
â€¢ Wireshark - åº•å±‚ç½‘ç»œåŒ…åˆ†æ

APIæµ‹è¯•å·¥å…·ï¼š
â€¢ Postman - æ¥å£æµ‹è¯•å’Œè°ƒè¯•
â€¢ Insomnia - è½»é‡çº§APIå®¢æˆ·ç«¯
â€¢ curl - å‘½ä»¤è¡Œå·¥å…·

å°±åƒåŒ»ç”Ÿçš„å¬è¯Šå™¨ï¼š
â€¢ ä¸åŒå·¥å…·æœ‰ä¸åŒçš„"å¬è¯Š"èƒ½åŠ›
â€¢ æœ‰çš„èƒ½å¬å¿ƒè·³(è¯·æ±‚å“åº”)
â€¢ æœ‰çš„èƒ½çœ‹Xå…‰ç‰‡(æ•°æ®åŒ…ç»“æ„)
â€¢ æœ‰çš„èƒ½åšCT(æ·±åº¦åˆ†æ)
```

### 6.2 Chrome DevToolsè°ƒè¯•SSO


**ğŸ” Networké¢æ¿ä½¿ç”¨æŠ€å·§**
```
SSOç™»å½•æµç¨‹è°ƒè¯•ï¼š

æ­¥éª¤1ï¼šæ‰“å¼€å¼€å‘è€…å·¥å…·
â€¢ æŒ‰F12æˆ–å³é”®é€‰æ‹©"æ£€æŸ¥"
â€¢ åˆ‡æ¢åˆ°Networké¢æ¿
â€¢ å‹¾é€‰"Preserve log"ä¿ç•™æ—¥å¿—

æ­¥éª¤2ï¼šè®°å½•ç™»å½•æµç¨‹
â€¢ æ¸…ç©ºå½“å‰è®°å½•
â€¢ å¼€å§‹ç™»å½•æ“ä½œ
â€¢ è§‚å¯Ÿæ¯ä¸ªè¯·æ±‚çš„çŠ¶æ€

æ­¥éª¤3ï¼šåˆ†æå…³é”®è¯·æ±‚
â€¢ æŸ¥æ‰¾302é‡å®šå‘è¯·æ±‚
â€¢ æ£€æŸ¥Set-Cookieå¤´ä¿¡æ¯
â€¢ éªŒè¯Authorizationå¤´ä¼ é€’
```

**ğŸ“Š å…³é”®ä¿¡æ¯æŸ¥çœ‹æ–¹æ³•**
```
è¯·æ±‚å¤´ä¿¡æ¯(Request Headers)ï¼š
âœ… Authorization: Bearer xxx
âœ… Cookie: JSESSIONID=xxx; sso_token=yyy  
âœ… Referer: https://app.example.com/login
âœ… User-Agent: æµè§ˆå™¨ä¿¡æ¯

å“åº”å¤´ä¿¡æ¯(Response Headers)ï¼š
âœ… Set-Cookie: sso_token=abc123; Domain=.example.com
âœ… Location: https://app.example.com/callback?code=xyz
âœ… Access-Control-Allow-Origin: *
âœ… Cache-Control: no-cache

çŠ¶æ€ç å«ä¹‰ï¼š
â€¢ 200 - è¯·æ±‚æˆåŠŸ
â€¢ 302 - é‡å®šå‘(SSOæµç¨‹ä¸­å¸¸è§)
â€¢ 401 - æœªæˆæƒï¼Œéœ€è¦ç™»å½•
â€¢ 403 - å·²ç™»å½•ä½†æƒé™ä¸è¶³
â€¢ 500 - æœåŠ¡å™¨é”™è¯¯
```

**ğŸ§ª Applicationé¢æ¿è°ƒè¯•**
```javascript
// åœ¨Consoleé¢æ¿ä¸­æ‰§è¡Œè°ƒè¯•å‘½ä»¤

// æŸ¥çœ‹æ‰€æœ‰Cookie
document.cookie

// æŸ¥çœ‹ç‰¹å®šCookie  
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
}
console.log('SSO Token:', getCookie('sso_token'));

// æŸ¥çœ‹localStorage
console.log('Local Storage:', localStorage);

// æŸ¥çœ‹sessionStorage  
console.log('Session Storage:', sessionStorage);

// æ¸…é™¤æ‰€æœ‰å­˜å‚¨(æµ‹è¯•ç”¨)
localStorage.clear();
sessionStorage.clear();
document.cookie.split(";").forEach(function(c) { 
    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
});
```

### 6.3 FiddleræŠ“åŒ…åˆ†æ


**ğŸ”§ FiddleråŸºç¡€é…ç½®**
```
å®‰è£…å’Œè®¾ç½®ï¼š
1. ä¸‹è½½å®‰è£…Fiddler Classic
2. Tools â†’ Options â†’ Connections
   âœ… å‹¾é€‰ "Allow remote computers to connect"
   âœ… è®¾ç½®ç«¯å£(é»˜è®¤8888)

3. Tools â†’ Options â†’ HTTPS  
   âœ… å‹¾é€‰ "Capture HTTPS CONNECTs"
   âœ… å‹¾é€‰ "Decrypt HTTPS traffic"
   âœ… å®‰è£…è¯ä¹¦

4. æµè§ˆå™¨ä»£ç†è®¾ç½®
   â€¢ æ‰‹åŠ¨è®¾ç½®ä»£ç†: 127.0.0.1:8888
   â€¢ æˆ–ä½¿ç”¨Fiddlerè‡ªåŠ¨é…ç½®
```

**ğŸ“‹ SSOæµç¨‹æŠ“åŒ…åˆ†æ**
```
æŠ“åŒ…ä¼šè¯åˆ†æï¼š

è¯·æ±‚1: GET /login
Host: app.example.com
Cookie: (æ— )
â†’ å“åº”: 302 Redirect to SSO

è¯·æ±‚2: GET /sso/authorize?client_id=xxx&redirect_uri=xxx
Host: sso.example.com  
Cookie: (æ— )
â†’ å“åº”: 200 ç™»å½•é¡µé¢

è¯·æ±‚3: POST /sso/login
Host: sso.example.com
Content-Type: application/x-www-form-urlencoded
Body: username=user&password=pass
â†’ å“åº”: 302 + Set-Cookie: sso_session=abc123

è¯·æ±‚4: GET /callback?code=xyz123
Host: app.example.com
Cookie: sso_session=abc123
â†’ å“åº”: 200 ç™»å½•æˆåŠŸé¡µé¢
```

**ğŸ› ï¸ Fiddleré«˜çº§åŠŸèƒ½**
```csharp
// FiddlerScriptç¤ºä¾‹ - è‡ªåŠ¨é«˜äº®SSOç›¸å…³è¯·æ±‚
static function OnBeforeRequest(oSession: Session) {
    // é«˜äº®SSOç›¸å…³è¯·æ±‚
    if (oSession.host.indexOf("sso.") >= 0 || 
        oSession.PathAndQuery.indexOf("login") >= 0 ||
        oSession.PathAndQuery.indexOf("callback") >= 0) {
        oSession["ui-color"] = "red";
        oSession["ui-bold"] = "true";
    }
    
    // æ·»åŠ è‡ªå®šä¹‰æ ‡è®°
    if (oSession.RequestHeaders.Exists("Authorization")) {
        oSession["ui-comments"] = "æœ‰Authorizationå¤´";
    }
}

// å“åº”ä¿®æ”¹(æµ‹è¯•ç”¨)
static function OnBeforeResponse(oSession: Session) {
    // ä¿®æ”¹å“åº”å¤´æµ‹è¯•å…¼å®¹æ€§
    if (oSession.host == "sso.example.com") {
        oSession.ResponseHeaders.Add("Access-Control-Allow-Origin", "*");
    }
}
```

### 6.4 Postmanæ¥å£æµ‹è¯•


**ğŸ§ª SSOæ¥å£æµ‹è¯•å¥—ä»¶**
```javascript
// Postman Pre-request Script
// è·å–è®¤è¯tokençš„æµ‹è¯•è„šæœ¬

const loginRequest = {
    url: 'https://sso.example.com/api/login',
    method: 'POST',
    header: {
        'Content-Type': 'application/json'
    },
    body: {
        mode: 'raw',
        raw: JSON.stringify({
            username: pm.environment.get('test_username'),
            password: pm.environment.get('test_password')
        })
    }
};

pm.sendRequest(loginRequest, function (err, response) {
    if (err) {
        console.log('ç™»å½•è¯·æ±‚å¤±è´¥:', err);
        return;
    }
    
    const responseJson = response.json();
    if (responseJson.token) {
        // ä¿å­˜tokenä¾›åç»­è¯·æ±‚ä½¿ç”¨
        pm.environment.set('auth_token', responseJson.token);
        console.log('Tokenè·å–æˆåŠŸ:', responseJson.token);
    } else {
        console.log('ç™»å½•å¤±è´¥:', responseJson.message);
    }
});

// Postman Test Script  
// éªŒè¯å“åº”çš„æµ‹è¯•è„šæœ¬
pm.test("å“åº”çŠ¶æ€ç ä¸º200", function () {
    pm.response.to.have.status(200);
});

pm.test("å“åº”åŒ…å«å¿…è¦å­—æ®µ", function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('success');
    pm.expect(jsonData).to.have.property('data');
});

pm.test("Cookieè®¾ç½®æ­£ç¡®", function () {
    pm.expect(pm.response.headers.get('Set-Cookie')).to.include('sso_token');
});

// è‡ªåŠ¨æå–é‡è¦ä¿¡æ¯
const responseJson = pm.response.json();
if (responseJson.access_token) {
    pm.environment.set('access_token', responseJson.access_token);
}
```

**ğŸ“Š Postmanç¯å¢ƒé…ç½®**
```json
{
    "name": "SSOæµ‹è¯•ç¯å¢ƒ",
    "values": [
        {
            "key": "base_url",
            "value": "https://sso.example.com",
            "description": "SSOæœåŠ¡å™¨åœ°å€"
        },
        {
            "key": "test_username", 
            "value": "testuser",
            "description": "æµ‹è¯•ç”¨æˆ·å"
        },
        {
            "key": "test_password",
            "value": "testpass123",
            "description": "æµ‹è¯•å¯†ç "
        },
        {
            "key": "client_id",
            "value": "app001",
            "description": "åº”ç”¨ID"
        },
        {
            "key": "redirect_uri",
            "value": "https://app.example.com/callback",
            "description": "å›è°ƒåœ°å€"
        }
    ]
}
```

### 6.5 å‘½ä»¤è¡Œè°ƒè¯•å·¥å…·


**ğŸ’» curlå‘½ä»¤è°ƒè¯•**
```bash
# SSOç™»å½•æµç¨‹curlæµ‹è¯•

# 1. è·å–ç™»å½•é¡µé¢
curl -v -c cookies.txt "https://sso.example.com/login" 

# 2. æäº¤ç™»å½•ä¿¡æ¯
curl -v -b cookies.txt -c cookies.txt \
  -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=testpass" \
  "https://sso.example.com/api/login"

# 3. ä½¿ç”¨è·å–çš„tokenè®¿é—®å—ä¿æŠ¤èµ„æº
curl -v -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  "https://app.example.com/api/user/profile"

# 4. æµ‹è¯•tokenéªŒè¯æ¥å£
curl -v -X POST \
  -H "Content-Type: application/json" \
  -d '{"token":"YOUR_TOKEN_HERE"}' \
  "https://sso.example.com/api/validate"
```

**ğŸ” æ—¥å¿—åˆ†æè„šæœ¬**
```bash
#!/bin/bash
# SSOæ—¥å¿—åˆ†æè„šæœ¬

LOG_FILE="/var/log/sso/access.log"
DATE=$(date +%Y-%m-%d)

echo "=== SSOæ—¥å¿—åˆ†ææŠ¥å‘Š ($DATE) ==="

# ç»Ÿè®¡ç™»å½•è¯·æ±‚
echo "ç™»å½•è¯·æ±‚ç»Ÿè®¡:"
grep -c "POST.*login" $LOG_FILE

# ç»Ÿè®¡å¤±è´¥ç™»å½•
echo "å¤±è´¥ç™»å½•ç»Ÿè®¡:"  
grep -c "POST.*login.*401\|POST.*login.*403" $LOG_FILE

# æœ€é¢‘ç¹çš„IPåœ°å€
echo "æœ€æ´»è·ƒçš„IPåœ°å€:"
awk '{print $1}' $LOG_FILE | sort | uniq -c | sort -nr | head -10

# é”™è¯¯çŠ¶æ€ç ç»Ÿè®¡
echo "é”™è¯¯çŠ¶æ€ç ç»Ÿè®¡:"
awk '$9 >= 400 {print $9}' $LOG_FILE | sort | uniq -c | sort -nr

# å“åº”æ—¶é—´åˆ†æ
echo "å¹³å‡å“åº”æ—¶é—´:"
awk '{print $NF}' $LOG_FILE | awk '{sum+=$1; count++} END {print sum/count "ms"}'
```

### 6.6 è°ƒè¯•æœ€ä½³å®è·µ


**ğŸ’¡ è°ƒè¯•ç­–ç•¥**
```
é—®é¢˜åˆ†ç±»è°ƒè¯•ï¼š

ç™»å½•é—®é¢˜ï¼š
1. æ£€æŸ¥ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹è®¤è¯è¯·æ±‚çš„å‚æ•°æ ¼å¼  
3. éªŒè¯å“åº”ä¸­çš„cookieè®¾ç½®
4. ç¡®è®¤é‡å®šå‘URLæ­£ç¡®æ€§

æƒé™é—®é¢˜ï¼š
1. æ£€æŸ¥tokenæ˜¯å¦åŒ…å«æ­£ç¡®çš„æƒé™ä¿¡æ¯
2. éªŒè¯tokenæ˜¯å¦è¿‡æœŸ
3. ç¡®è®¤è§’è‰²æƒé™é…ç½®æ­£ç¡®
4. æ£€æŸ¥èµ„æºè®¿é—®æ§åˆ¶è§„åˆ™

è·¨åŸŸé—®é¢˜ï¼š
1. æ£€æŸ¥CORSå“åº”å¤´è®¾ç½®
2. éªŒè¯é¢„æ£€è¯·æ±‚(OPTIONS)å¤„ç†
3. ç¡®è®¤cookieçš„åŸŸåè®¾ç½®
4. æ£€æŸ¥æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥

æ€§èƒ½é—®é¢˜ï¼š
1. åˆ†æè¯·æ±‚å“åº”æ—¶é—´
2. æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡
3. ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
4. åˆ†æç½‘ç»œå»¶è¿Ÿ
```

**ğŸ“‹ è°ƒè¯•æ£€æŸ¥æ¸…å•**
```
åŸºç¡€æ£€æŸ¥ï¼š
â˜‘ï¸ ç½‘ç»œè¿é€šæ€§æ­£å¸¸
â˜‘ï¸ DNSè§£ææ­£ç¡®  
â˜‘ï¸ SSLè¯ä¹¦æœ‰æ•ˆ
â˜‘ï¸ ç³»ç»Ÿæ—¶é—´åŒæ­¥

é…ç½®æ£€æŸ¥ï¼š
â˜‘ï¸ å›è°ƒåœ°å€é…ç½®æ­£ç¡®
â˜‘ï¸ å®¢æˆ·ç«¯IDå’Œå¯†é’¥æ­£ç¡®
â˜‘ï¸ æƒé™èŒƒå›´é…ç½®åˆç†
â˜‘ï¸ ä¼šè¯è¶…æ—¶è®¾ç½®åˆç†

å®‰å…¨æ£€æŸ¥ï¼š
â˜‘ï¸ HTTPSé…ç½®æ­£ç¡®
â˜‘ï¸ Cookieå®‰å…¨å±æ€§è®¾ç½®
â˜‘ï¸ CSRFä¿æŠ¤å¯ç”¨
â˜‘ï¸ è¾“å…¥å‚æ•°éªŒè¯

æ€§èƒ½æ£€æŸ¥ï¼š  
â˜‘ï¸ å“åº”æ—¶é—´åœ¨åˆç†èŒƒå›´
â˜‘ï¸ æ•°æ®åº“è¿æ¥æ± æ­£å¸¸
â˜‘ï¸ ç¼“å­˜ç­–ç•¥æœ‰æ•ˆ
â˜‘ï¸ æ—¥å¿—è®°å½•é€‚åº¦
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SSOé—®é¢˜æœ¬è´¨ï¼šå¤šåº”ç”¨é—´çŠ¶æ€åŒæ­¥å¤±æ•ˆ
ğŸ”¸ è°ƒè¯•æ€ç»´ï¼šä»ç°è±¡åˆ°åŸå› çš„é€æ­¥æ’æŸ¥
ğŸ”¸ å·¥å…·ä½¿ç”¨ï¼šæµè§ˆå™¨DevTools + ä¸“ä¸šæŠ“åŒ…å·¥å…·
ğŸ”¸ é¢„é˜²ç­–ç•¥ï¼šæ ‡å‡†åŒ–é…ç½® + å®Œå–„ç›‘æ§
ğŸ”¸ åº”æ€¥å¤„ç†ï¼šå¿«é€Ÿå®šä½ + ä¸´æ—¶ç¼“è§£ + æ ¹æœ¬ä¿®å¤
```

### 7.2 å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨


| é—®é¢˜ç—‡çŠ¶ | **å¯èƒ½åŸå› ** | **å¿«é€Ÿæ£€æŸ¥** | **è§£å†³æ–¹å‘** |
|---------|------------|-------------|-------------|
| ğŸ”„ **ç™»å½•æ­»å¾ªç¯** | `å›è°ƒé…ç½®é”™è¯¯` | `æ£€æŸ¥redirect_uriè®¾ç½®` | `ä¿®æ­£å›è°ƒåœ°å€é…ç½®` |
| ğŸ« **çŠ¶æ€ä¸ä¸€è‡´** | `tokenå’Œsessionä¸åŒæ­¥` | `æ£€æŸ¥è¿‡æœŸæ—¶é—´è®¾ç½®` | `ç»Ÿä¸€æ—¶é—´æˆ–å®šæœŸéªŒè¯` |
| ğŸ–¥ï¸ **å…¼å®¹æ€§é—®é¢˜** | `æµè§ˆå™¨å·®å¼‚` | `æµ‹è¯•ä¸åŒæµè§ˆå™¨` | `å…¼å®¹æ€§é€‚é…ä»£ç ` |
| âš–ï¸ **ä¼šè¯ä¸¢å¤±** | `è´Ÿè½½å‡è¡¡é…ç½®` | `æ£€æŸ¥sessionå­˜å‚¨æ–¹å¼` | `å…±äº«å­˜å‚¨æˆ–JWT` |

### 7.3 æ’æŸ¥å·¥å…·é€‰æ‹©æŒ‡å—


```
åˆçº§é—®é¢˜æ’æŸ¥ï¼š
âœ… Chrome DevTools - æŸ¥çœ‹è¯·æ±‚å’Œcookie
âœ… æµè§ˆå™¨éšç§æ¨¡å¼ - æ’é™¤ç¼“å­˜å¹²æ‰°
âœ… ç®€å•curlå‘½ä»¤ - éªŒè¯æ¥å£

ä¸­çº§é—®é¢˜æ’æŸ¥ï¼š
âœ… Fiddler/Charles - è¯¦ç»†æŠ“åŒ…åˆ†æ  
âœ… Postman - æ¥å£æµ‹è¯•å’Œè‡ªåŠ¨åŒ–
âœ… æ—¥å¿—åˆ†æè„šæœ¬ - æ‰¹é‡æ•°æ®åˆ†æ

é«˜çº§é—®é¢˜æ’æŸ¥ï¼š
âœ… Wireshark - åº•å±‚ç½‘ç»œåˆ†æ
âœ… æ€§èƒ½ç›‘æ§å·¥å…· - APMé›†æˆ
âœ… è‡ªå®šä¹‰è°ƒè¯•å·¥å…· - ä¸šåŠ¡ç‰¹å®šéœ€æ±‚
```

### 7.4 é¢„é˜²é—®é¢˜çš„æœ€ä½³å®è·µ


**ğŸ›¡ï¸ é…ç½®æ ‡å‡†åŒ–**
```
å¼€å‘é˜¶æ®µï¼š
â€¢ ç»Ÿä¸€çš„é…ç½®æ¨¡æ¿
â€¢ è‡ªåŠ¨åŒ–çš„é…ç½®éªŒè¯
â€¢ å®Œå–„çš„å•å…ƒæµ‹è¯•

æµ‹è¯•é˜¶æ®µï¼š
â€¢ å¤šæµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
â€¢ è´Ÿè½½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•
â€¢ å¼‚å¸¸åœºæ™¯æ¨¡æ‹Ÿæµ‹è¯•

éƒ¨ç½²é˜¶æ®µï¼š
â€¢ è“ç»¿éƒ¨ç½²é¿å…æœåŠ¡ä¸­æ–­
â€¢ é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†
â€¢ å®æ—¶ç›‘æ§å’Œå‘Šè­¦

è¿ç»´é˜¶æ®µï¼š
â€¢ å®šæœŸå¥åº·æ£€æŸ¥
â€¢ æ€§èƒ½åŸºçº¿ç›‘æ§
â€¢ æ•…éšœé¢„æ¡ˆæ¼”ç»ƒ
```

**ğŸ“Š ç›‘æ§æŒ‡æ ‡ä½“ç³»**
```
ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ï¼š
â€¢ ç™»å½•æˆåŠŸç‡ > 99%
â€¢ ç™»å½•å“åº”æ—¶é—´ < 2ç§’
â€¢ ä¼šè¯ä¿æŒç¨³å®šæ€§ > 95%

ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼š
â€¢ æ¥å£å“åº”æ—¶é—´ < 500ms
â€¢ é”™è¯¯ç‡ < 0.1%
â€¢ ç³»ç»Ÿå¯ç”¨æ€§ > 99.9%

ä¸šåŠ¡å®‰å…¨æŒ‡æ ‡ï¼š
â€¢ å¼‚å¸¸ç™»å½•æ£€æµ‹
â€¢ æš´åŠ›ç ´è§£é˜²æŠ¤
â€¢ æ•æ„Ÿæ“ä½œå®¡è®¡
```

### 7.5 åº”æ€¥å“åº”é¢„æ¡ˆ


**ğŸš¨ æ•…éšœç­‰çº§åˆ’åˆ†**
```
P0çº§æ•…éšœ(å½±å“å…¨ç«™)ï¼š
â€¢ æ‰€æœ‰ç”¨æˆ·æ— æ³•ç™»å½•
â€¢ SSOæœåŠ¡å®Œå…¨ä¸å¯ç”¨
â€¢ å“åº”æ—¶é—´ï¼š15åˆ†é’Ÿå†…

P1çº§æ•…éšœ(å½±å“éƒ¨åˆ†åŠŸèƒ½)ï¼š
â€¢ ç‰¹å®šæµè§ˆå™¨ç™»å½•å¼‚å¸¸
â€¢ éƒ¨åˆ†åº”ç”¨é›†æˆé—®é¢˜  
â€¢ å“åº”æ—¶é—´ï¼š1å°æ—¶å†…

P2çº§æ•…éšœ(ç”¨æˆ·ä½“éªŒå½±å“)ï¼š
â€¢ ç™»å½•æµç¨‹ä½“éªŒé—®é¢˜
â€¢ éå…³é”®åŠŸèƒ½å¼‚å¸¸
â€¢ å“åº”æ—¶é—´ï¼š4å°æ—¶å†…
```

**ğŸ”§ åº”æ€¥å¤„ç†æµç¨‹**
```
ç¬¬ä¸€é˜¶æ®µ(0-15åˆ†é’Ÿ)ï¼š
1. ç¡®è®¤æ•…éšœèŒƒå›´å’Œå½±å“
2. å¯åŠ¨åº”æ€¥å“åº”å°ç»„
3. å®æ–½ä¸´æ—¶ç¼“è§£æªæ–½

ç¬¬äºŒé˜¶æ®µ(15åˆ†é’Ÿ-1å°æ—¶)ï¼š
1. æ·±å…¥åˆ†ææ ¹æœ¬åŸå› 
2. åˆ¶å®šä¿®å¤æ–¹æ¡ˆ
3. æ‰§è¡Œä¿®å¤æ“ä½œ

ç¬¬ä¸‰é˜¶æ®µ(1å°æ—¶å)ï¼š
1. éªŒè¯ä¿®å¤æ•ˆæœ
2. ç›‘æ§ç³»ç»Ÿç¨³å®šæ€§
3. æ€»ç»“ç»éªŒæ•™è®­
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
SSOé—®é¢˜æ’æŸ¥è¦ç‚¹ï¼š
ç°è±¡è§‚å¯Ÿè¦ä»”ç»†ï¼Œå·¥å…·é€‰æ‹©éœ€åˆç†
é…ç½®æ£€æŸ¥æ˜¯åŸºç¡€ï¼Œæ—¥å¿—åˆ†ææ‰¾è§„å¾‹
é¢„é˜²èƒœè¿‡æ²»ç–—å¥½ï¼Œç›‘æ§å‘Šè­¦ä¸å¯å°‘
```