---
title: 12、磁盘性能测试命令
---
## 📚 目录

1. [磁盘性能测试概述](#1-磁盘性能测试概述)
2. [dd命令 - 基础读写性能测试](#2-dd命令-基础读写性能测试)
3. [hdparm命令 - 硬件级性能测试](#3-hdparm命令-硬件级性能测试)
4. [iostat命令 - I/O统计分析](#4-iostat命令-io统计分析)
5. [iotop命令 - 实时I/O监控](#5-iotop命令-实时io监控)
6. [fio命令 - 专业性能测试工具](#6-fio命令-专业性能测试工具)
7. [sync命令 - 缓存同步](#7-sync命令-缓存同步)
8. [磁盘基准测试策略](#8-磁盘基准测试策略)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 📊 磁盘性能测试概述


### 1.1 为什么要测试磁盘性能


**🎯 核心作用**：
磁盘性能直接影响系统整体运行速度，特别是在数据库、文件服务器等场景下。通过性能测试可以：

- **🔍 发现瓶颈**：找出系统慢的根本原因
- **📈 优化配置**：调整系统参数提升性能  
- **🛠️ 硬件选型**：为服务器选择合适的存储设备
- **📋 容量规划**：预估未来的性能需求

### 1.2 磁盘性能的关键指标


**📊 主要指标解释**：

```
性能指标对照表：
┌─────────────┬──────────────┬─────────────────┐
│   指标名称   │    含义      │   典型数值      │
├─────────────┼──────────────┼─────────────────┤
│ 吞吐量      │ 每秒读写数据量 │ 100MB/s～3GB/s │
│ IOPS        │ 每秒操作次数  │ 100～50000     │
│ 延迟        │ 单次操作时间  │ 1ms～100ms     │
│ 队列深度    │ 并发操作数量  │ 1～32          │
└─────────────┴──────────────┴─────────────────┘
```

**💡 指标含义详解**：
- **吞吐量（Throughput）**：就像水管的流量，表示单位时间内能传输多少数据
- **IOPS（每秒输入输出操作数）**：类似快递员每分钟能处理多少个包裹
- **延迟（Latency）**：从发出请求到得到响应的时间差
- **队列深度（Queue Depth）**：同时等待处理的任务数量

---

## 2. 💾 dd命令 - 基础读写性能测试


### 2.1 dd命令基本原理


**🔸 工作机制**：
`dd`命令最初是"数据复制"工具，但因为能精确控制读写操作，成为了最常用的磁盘性能测试工具。

**基本语法**：
```bash
dd if=输入文件 of=输出文件 bs=块大小 count=块数量
```

### 2.2 测试磁盘写入性能


**🚀 写入性能测试**：

```bash
# 测试写入速度 - 创建1GB测试文件
dd if=/dev/zero of=testfile bs=1M count=1024

# 输出示例：
# 1024+0 records in
# 1024+0 records out
# 1073741824 bytes (1.1 GB) copied, 10.5 seconds, 102 MB/s
```

**📊 参数详解**：
- `if=/dev/zero`：从零设备读取（产生全零数据）
- `of=testfile`：写入到测试文件
- `bs=1M`：每次读写1MB数据块
- `count=1024`：总共读写1024个块

> 💡 **原理解释**：`/dev/zero`是Linux的特殊设备，能无限产生零字节，读取它几乎不消耗时间，所以测试结果主要反映磁盘写入性能。

### 2.3 测试磁盘读取性能


**📖 读取性能测试**：

```bash
# 清除系统缓存（确保真正从磁盘读取）
sync && echo 3 > /proc/sys/vm/drop_caches

# 测试读取速度
dd if=testfile of=/dev/null bs=1M count=1024

# 输出示例：
# 1024+0 records in  
# 1024+0 records out
# 1073741824 bytes (1.1 GB) copied, 8.2 seconds, 131 MB/s
```

**🔸 关键点说明**：
- `of=/dev/null`：数据写入到空设备（相当于丢弃）
- 先清缓存很重要，否则测试的是内存读取速度

### 2.4 dd命令的高级用法


**⚡ 常用测试组合**：

| 测试类型 | 命令示例 | 用途说明 |
|---------|---------|---------|
| **随机写入** | `dd if=/dev/urandom of=test bs=1M count=100` | 测试随机数据写入性能 |
| **大块写入** | `dd if=/dev/zero of=test bs=1G count=1` | 测试大数据块传输 |
| **小块写入** | `dd if=/dev/zero of=test bs=4K count=10000` | 模拟小文件场景 |
| **直接I/O** | `dd if=/dev/zero of=test bs=1M count=1024 oflag=direct` | 绕过系统缓存 |

**🎯 实用技巧**：
- 使用`oflag=direct`可以绕过系统缓存，得到真实的磁盘性能
- 不同的`bs`值会影响测试结果，通常1M～4M比较合适
- 测试文件大小应该明显大于系统内存，避免缓存影响

---

## 3. 🔧 hdparm命令 - 硬件级性能测试


### 3.1 hdparm命令介绍


**💡 核心概念**：
`hdparm`是专门用于测试和配置硬盘参数的工具，能够直接与硬件通信，获得更准确的性能数据。

**安装方法**：
```bash
# Ubuntu/Debian系统
sudo apt-get install hdparm

# CentOS/RHEL系统  
sudo yum install hdparm
```

### 3.2 测试磁盘读取速度 (hdparm -t)


**📊 磁盘直接读取测试**：

```bash
# 测试磁盘真实读取速度
sudo hdparm -t /dev/sda

# 输出示例：
# /dev/sda:
#  Timing buffered disk reads: 366 MB in 3.01 seconds = 121.59 MB/sec
```

**🔸 工作原理**：
- `-t`参数测试的是**从磁盘到系统内存**的数据传输速度
- 这个测试会绕过磁盘缓存，直接读取磁盘数据
- 结果反映磁盘硬件的真实读取能力

### 3.3 测试缓存读取速度 (hdparm -T)


**⚡ 缓存性能测试**：

```bash
# 测试系统缓存读取速度
sudo hdparm -T /dev/sda

# 输出示例：
# /dev/sda:
#  Timing cached reads: 12228 MB in 2.00 seconds = 6126.95 MB/sec
```

**💭 对比理解**：
```
性能对比示例：
磁盘直接读取(-t): 121 MB/s     ← 硬盘的真实速度
缓存读取速度(-T): 6126 MB/s    ← 内存的读取速度

差异原因：内存速度比硬盘快50倍以上！
```

### 3.4 综合测试与参数调优


**🔍 全面性能检测**：

```bash
# 同时测试磁盘和缓存性能
sudo hdparm -tT /dev/sda

# 查看磁盘详细信息
sudo hdparm -I /dev/sda

# 测试多次取平均值
sudo hdparm -t --direct /dev/sda
```

**⚙️ 性能调优选项**：
- `--direct`：使用直接I/O，更准确
- `-W 1`：启用写缓存（提升写入性能）
- `-A 1`：启用预读功能（提升顺序读取）

> ⚠️ **安全提醒**：修改硬盘参数可能影响数据安全，建议先备份重要数据。

---

## 4. 📈 iostat命令 - I/O统计分析


### 4.1 iostat命令概述


**🎯 主要功能**：
`iostat`是系统性能监控工具包（sysstat）的一部分，能够实时显示系统的I/O统计信息，帮助分析磁盘使用情况。

**安装方法**：
```bash
# Ubuntu/Debian
sudo apt-get install sysstat

# CentOS/RHEL
sudo yum install sysstat
```

### 4.2 基本使用方法


**📊 实时I/O监控**：

```bash
# 每2秒显示一次I/O统计，显示5次
iostat 2 5

# 只显示磁盘统计信息
iostat -d 2 5

# 显示扩展统计信息
iostat -x 2 5
```

**📋 输出示例解读**：
```
Device            r/s     w/s     rkB/s    wkB/s  await  util%
sda              12.5    8.3    156.2     98.4    5.2    2.1
```

### 4.3 关键指标详解


**🔢 重要指标含义**：

| 指标名称 | 含义解释 | 正常范围 | 异常表现 |
|---------|---------|---------|---------|
| **r/s** | 每秒读操作次数 | < 100 | > 500表示读密集 |
| **w/s** | 每秒写操作次数 | < 50 | > 200表示写密集 |
| **rkB/s** | 每秒读取的KB数 | < 10MB/s | > 100MB/s高负载 |
| **wkB/s** | 每秒写入的KB数 | < 5MB/s | > 50MB/s高负载 |
| **await** | 平均等待时间(ms) | < 10ms | > 50ms性能差 |
| **util%** | 磁盘使用率 | < 80% | > 95%接近饱和 |

**💡 实际应用场景**：

① **数据库服务器性能分析**：
```bash
# 监控数据库磁盘I/O
iostat -x 1 | grep -E "(Device|sda)"
```

② **发现I/O瓶颈**：
- `util%`接近100% → 磁盘已达到性能极限
- `await`很高 → 磁盘响应慢，可能需要升级硬件
- `r/s`和`w/s`很高 → 应用程序I/O密集

---

## 5. 👀 iotop命令 - 实时I/O监控


### 5.1 iotop工具介绍


**🔍 功能特点**：
`iotop`就像系统的"任务管理器"，但专门显示哪些进程在进行磁盘读写操作，能够实时看到每个程序的I/O使用情况。

**安装方法**：
```bash
# Ubuntu/Debian
sudo apt-get install iotop

# CentOS/RHEL
sudo yum install iotop
```

### 5.2 基本使用方法


**⚡ 实时I/O进程监控**：

```bash
# 启动iotop（需要root权限）
sudo iotop

# 只显示有I/O活动的进程
sudo iotop -o

# 按累计I/O排序
sudo iotop -a
```

### 5.3 界面信息解读


**📱 iotop显示界面**：
```
Total DISK READ:    15.2 M/s | Total DISK WRITE:   8.6 M/s
Actual DISK READ:   12.1 M/s | Actual DISK WRITE:  7.2 M/s

  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN    IO>    COMMAND
 1234  be/4  mysql       8.2 M/s     2.1 M/s   0.0%  85.2%  mysqld
 5678  be/4  apache      1.8 M/s     0.5 M/s   0.0%  12.8%  httpd
```

**🔸 关键信息说明**：
- **Total vs Actual**：Total包括缓存，Actual是真实磁盘I/O
- **TID**：线程ID，可以看到具体是哪个程序在使用磁盘
- **IO%**：该进程占用的I/O时间百分比
- **COMMAND**：具体的程序名称

### 5.4 实用快捷键


**⌨️ 交互操作**：
- `o`：只显示有I/O活动的进程
- `r`：反向排序
- `a`：按累计I/O排序
- `q`：退出程序

**📊 使用场景示例**：

① **找出占用磁盘的程序**：
```bash
# 找到消耗磁盘最多的程序
sudo iotop -o -d 1
```

② **监控特定时间段**：
```bash
# 监控10秒钟的I/O活动
timeout 10s sudo iotop -a
```

---

## 6. 🚀 fio命令 - 专业性能测试工具


### 6.1 fio工具介绍


**🎯 专业级测试**：
`fio`（Flexible I/O Tester）是目前最专业的磁盘性能测试工具，能够模拟各种真实的I/O场景，提供精确的性能数据。

**安装方法**：
```bash
# Ubuntu/Debian
sudo apt-get install fio

# CentOS/RHEL
sudo yum install fio
```

### 6.2 基础性能测试


**📊 顺序读写测试**：

```bash
# 顺序写入测试
fio --name=seqwrite --rw=write --bs=1M --size=1G --numjobs=1

# 顺序读取测试  
fio --name=seqread --rw=read --bs=1M --size=1G --numjobs=1

# 输出关键信息：
# write: IOPS=102, BW=102MiB/s (107MB/s)
# lat (msec): min=2, max=15, avg=9.7
```

**🔸 参数含义**：
- `--name`：测试任务名称
- `--rw`：读写模式（read/write/randread/randwrite）
- `--bs`：块大小（4k/1M等）
- `--size`：测试文件大小
- `--numjobs`：并发任务数

### 6.3 随机I/O性能测试


**🎲 随机读写测试**：

```bash
# 随机写入测试（模拟数据库写入）
fio --name=randwrite --rw=randwrite --bs=4k --size=500M --numjobs=4

# 随机读取测试（模拟数据库查询）
fio --name=randread --rw=randread --bs=4k --size=500M --numjobs=4
```

**💡 测试场景对照表**：

| 测试类型 | 命令参数 | 模拟场景 | 关注指标 |
|---------|---------|---------|---------|
| **顺序读** | `rw=read bs=1M` | 文件下载、备份 | 带宽(MB/s) |
| **顺序写** | `rw=write bs=1M` | 日志写入、录像 | 带宽(MB/s) |
| **随机读** | `rw=randread bs=4k` | 数据库查询 | IOPS |
| **随机写** | `rw=randwrite bs=4k` | 数据库更新 | IOPS |

### 6.4 高级测试配置


**⚙️ 专业测试脚本**：

```bash
# 创建综合测试配置文件 test.fio
cat > test.fio << EOF
[global]
ioengine=libaio
direct=1
size=1G
runtime=60

[seqread]
rw=read
bs=1M

[randread]  
rw=randread
bs=4k

[seqwrite]
rw=write
bs=1M

[randwrite]
rw=randwrite
bs=4k
EOF

# 运行综合测试
fio test.fio
```

**📈 结果分析要点**：
- **IOPS**：随机I/O关注这个指标
- **带宽(BW)**：顺序I/O关注这个指标  
- **延迟(lat)**：响应时间，越小越好
- **CPU使用率**：I/O操作对CPU的消耗

---

## 7. 🔄 sync命令 - 缓存同步


### 7.1 sync命令的作用


**💡 核心概念**：
Linux系统为了提高性能，会将数据先写入内存缓存，定期同步到磁盘。`sync`命令强制立即将缓存中的数据写入磁盘。

**🔸 为什么需要sync**：
```
正常写入流程：
应用程序 → 内存缓存 → (等待合适时机) → 磁盘

使用sync后：  
应用程序 → 内存缓存 → sync命令 → 立即写入磁盘
```

### 7.2 基本使用方法


**⚡ 强制同步操作**：

```bash
# 同步所有文件系统
sync

# 同步特定文件
fsync filename

# 同步并显示进度（部分Linux版本支持）
sync --help
```

### 7.3 在性能测试中的应用


**📊 确保测试准确性**：

```bash
# 测试前清理缓存的完整流程
echo "开始清理系统缓存..."
sync                                    # 1. 同步所有缓存到磁盘
echo 3 > /proc/sys/vm/drop_caches      # 2. 清除文件系统缓存
echo "缓存清理完成，开始性能测试"

# 现在进行的测试是真实磁盘性能
dd if=testfile of=/dev/null bs=1M count=1024
```

**🎯 实际应用场景**：

① **数据库维护**：
```bash
# 数据库备份前确保数据完整性
sync
mysqldump database > backup.sql
```

② **系统关机前**：
```bash
# 确保所有数据都已保存
sync && shutdown -h now
```

③ **测试环境准备**：
```bash
# 性能测试前的标准准备
sync && echo 3 > /proc/sys/vm/drop_caches
```

---

## 8. 🎯 磁盘基准测试策略


### 8.1 测试前的准备工作


**📋 环境准备清单**：

① **系统状态检查**：
```bash
# 检查系统负载
uptime

# 检查磁盘空间
df -h

# 检查内存使用
free -h
```

② **测试环境准备**：
```bash
# 停止不必要的服务
sudo systemctl stop mysql apache2

# 清理系统缓存
sync && echo 3 > /proc/sys/vm/drop_caches

# 设置测试目录
mkdir /tmp/disktest && cd /tmp/disktest
```

### 8.2 系统性的测试方案


**🔬 标准测试流程**：

```
测试流程图：
准备环境 → 基础测试 → 专业测试 → 结果分析 → 生成报告
    ↓         ↓        ↓        ↓        ↓
环境检查   dd测试    fio测试   数据对比   测试文档
缓存清理   hdparm    多场景    性能评估   建议措施
```

**📊 完整测试脚本示例**：

```bash
#!/bin/bash
# 磁盘性能综合测试脚本

echo "=== 磁盘性能综合测试 ==="
echo "测试时间: $(date)"
echo "测试设备: $1"

# 1. 基础信息收集
echo "1. 系统基础信息..."
uname -a
df -h $1
free -h

# 2. dd基础测试
echo "2. dd性能测试..."
sync && echo 3 > /proc/sys/vm/drop_caches
dd if=/dev/zero of=testfile bs=1G count=1 oflag=direct

# 3. hdparm硬件测试
echo "3. hdparm硬件测试..."
sudo hdparm -tT $1

# 4. fio专业测试
echo "4. fio专业测试..."
fio --name=comprehensive --rw=randrw --bs=4k --size=100M --runtime=30 --numjobs=4

echo "=== 测试完成 ==="
```

### 8.3 不同场景的测试参数


**🎪 应用场景测试对照**：

| 应用场景 | 测试重点 | 推荐参数 | 评判标准 |
|---------|---------|---------|---------|
| **Web服务器** | 随机读为主 | `bs=4k rw=randread` | IOPS > 1000 |
| **数据库服务器** | 随机读写混合 | `bs=4k rw=randrw` | 延迟 < 10ms |
| **文件服务器** | 顺序读写 | `bs=1M rw=read/write` | 带宽 > 100MB/s |
| **日志服务器** | 顺序写为主 | `bs=64k rw=write` | 写入 > 50MB/s |
| **备份服务器** | 大文件传输 | `bs=4M rw=read` | 带宽 > 200MB/s |

### 8.4 结果分析与性能调优


**📈 性能基准对照**：

```
磁盘类型性能参考：
┌──────────────┬──────────┬──────────┬─────────────┐
│   磁盘类型    │ 顺序读写  │ 随机IOPS │  延迟范围   │
├──────────────┼──────────┼──────────┼─────────────┤
│ 机械硬盘(HDD) │ 80-200MB/s│ 80-160  │ 10-20ms    │
│ 固态硬盘(SSD) │ 400-600MB/s│ 10K-50K │ 0.1-1ms    │
│ NVMe SSD     │ 1-3GB/s  │ 50K-500K│ 0.02-0.1ms │
│ 企业级SSD    │ 1-6GB/s  │ 100K-1M │ 0.01-0.05ms│
└──────────────┴──────────┴──────────┴─────────────┘
```

**⚙️ 性能优化建议**：

① **系统级优化**：
- 调整I/O调度器：`echo deadline > /sys/block/sda/queue/scheduler`
- 优化文件系统：选择ext4、xfs等高性能文件系统
- 调整缓存参数：修改`/proc/sys/vm/`下的参数

② **应用级优化**：
- 数据库：调整缓冲池大小、I/O线程数
- Web服务：启用静态文件缓存、压缩传输
- 日志系统：异步写入、批量操作

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心命令


```
🔸 dd - 基础性能测试的万能工具
🔸 hdparm -t/-T - 硬件级别的真实性能测试
🔸 iostat - 系统I/O状态的实时监控
🔸 iotop - 找出占用磁盘的具体程序
🔸 fio - 专业级的全面性能测试
🔸 sync - 确保测试准确性的缓存同步
```

### 9.2 关键理解要点


**🔹 测试准确性的保证**：
```
测试前三步骤：
1. sync - 同步缓存到磁盘
2. echo 3 > /proc/sys/vm/drop_caches - 清除缓存
3. 停止不必要的服务 - 减少干扰

没有这些步骤，测试的可能是内存性能，不是磁盘性能！
```

**🔹 选择合适的测试工具**：
```
快速检测 → dd命令（5分钟搞定）
硬件验证 → hdparm命令（直接测硬盘）
问题排查 → iostat + iotop（找到问题根源）  
专业测试 → fio命令（全面深入分析）
```

**🔹 理解不同的性能指标**：
```
顺序操作关注：带宽(MB/s) - 大文件传输能力
随机操作关注：IOPS - 小文件处理能力
响应速度关注：延迟(ms) - 用户体验指标
系统瓶颈关注：利用率(%) - 硬件负载情况
```

### 9.3 实际应用指导


**📊 常见问题诊断**：

① **系统运行慢**：
```bash
# 诊断步骤
iostat -x 1 5           # 看磁盘使用率
iotop -o                # 找占用磁盘的程序
hdparm -t /dev/sda      # 测试硬件性能
```

② **数据库性能差**：
```bash
# 专门测试数据库I/O场景
fio --name=db --rw=randrw --bs=4k --size=1G --numjobs=8
```

③ **服务器选型**：
```bash
# 全面性能测试
dd + hdparm + fio综合测试
对比不同硬件的测试结果
```

**🛠️ 性能优化路径**：
- **软件优化**：调整系统参数、文件系统、应用配置
- **硬件升级**：机械盘→固态盘→NVMe盘→企业级存储
- **架构改进**：单盘→RAID→分布式存储→云存储

**💡 记忆要诀**：
- 测试前先sync，结果才会准
- dd测基础，hdparm测硬件，fio最专业
- 看IOPS选随机，看带宽选顺序
- iostat看整体，iotop找问题
- 不同场景不同参数，对症下药才有效