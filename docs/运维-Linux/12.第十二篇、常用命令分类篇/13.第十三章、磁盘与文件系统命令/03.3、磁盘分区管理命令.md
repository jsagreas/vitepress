---
title: 3、磁盘分区管理命令
---
## 📚 目录

1. [分区管理基础概念](#1-分区管理基础概念)
2. [fdisk命令详解](#2-fdisk命令详解)
3. [gdisk命令详解](#3-gdisk命令详解)
4. [parted命令详解](#4-parted命令详解)
5. [图形化分区工具](#5-图形化分区工具)
6. [高级分区管理技巧](#6-高级分区管理技巧)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 💾 分区管理基础概念


### 1.1 什么是磁盘分区


**通俗理解**：想象一下把一个大房子分割成几个房间，每个房间有自己的门牌号和用途。磁盘分区就是把一块物理硬盘分割成多个逻辑区域，每个区域可以独立管理和使用。

```
物理硬盘 (500GB)
┌─────────────────────────────────────────────────┐
│  分区1    │  分区2    │  分区3    │   未分配     │
│  /       │  /home    │  swap     │   空间       │
│ (100GB)  │ (200GB)   │ (8GB)     │  (192GB)     │
└─────────────────────────────────────────────────┘
```

**为什么要分区？**
- 🎯 **系统管理**：把系统文件和用户数据分开
- 🔒 **数据安全**：一个分区出问题不会影响其他分区
- ⚡ **性能优化**：不同类型文件放在合适的分区
- 📊 **空间管理**：限制某个目录的最大使用空间

### 1.2 分区表类型对比


| 特性 | **MBR分区表** | **GPT分区表** |
|------|-------------|-------------|
| 💿 **支持磁盘大小** | `最大2TB` | `几乎无限制` |
| 🔢 **主分区数量** | `最多4个` | `最多128个` |
| 🛡️ **数据保护** | `单点故障` | `多重备份` |
| 🖥️ **启动方式** | `BIOS启动` | `UEFI启动` |
| ⏰ **技术年代** | `较老技术` | `现代标准` |

**💡 选择建议**：
- 新电脑、大硬盘（>2TB）：选择 **GPT**
- 老电脑、小硬盘（<2TB）：可选择 **MBR**

### 1.3 Linux分区命名规则


```
设备命名规律：
/dev/sda     ← 第一块SATA/SCSI硬盘
/dev/sda1    ← 第一块硬盘的第一个分区
/dev/sda2    ← 第一块硬盘的第二个分区
/dev/sdb     ← 第二块硬盘
/dev/nvme0n1 ← 第一块NVMe SSD硬盘
/dev/vda     ← 虚拟机中的第一块硬盘

记忆方法：
sd = SATA Disk
a,b,c = 硬盘编号（按字母顺序）
1,2,3 = 分区编号（按数字顺序）
```

---

## 2. 🔧 fdisk命令详解


### 2.1 fdisk基本概念


**fdisk是什么？** 它是Linux系统中最经典的分区管理工具，专门用来创建和管理MBR分区表。就像一个专业的"房屋设计师"，帮你规划硬盘空间。

**⚠️ 重要提醒**：fdisk操作分区表，使用前务必备份重要数据！

### 2.2 fdisk常用操作流程


**🚀 基本使用步骤**：

```bash
# 1. 查看系统中所有磁盘
fdisk -l

# 2. 进入某个磁盘的分区管理
fdisk /dev/sda

# 3. 在交互模式中使用命令（下面详细介绍）
```

### 2.3 fdisk交互命令详解


**📋 核心命令清单**：

```
进入fdisk交互界面后的常用命令：

信息查看类：
p  ← 打印当前分区表（Print）
l  ← 列出所有分区类型（List）

分区操作类：
n  ← 创建新分区（New）
d  ← 删除分区（Delete）
t  ← 更改分区类型（Type）

保存退出类：
w  ← 保存更改并退出（Write）
q  ← 不保存直接退出（Quit）

帮助类：
m  ← 显示帮助菜单（Menu）
```

### 2.4 fdisk实际操作示例


**📝 创建新分区的完整过程**：

```bash
# 1. 打开目标磁盘
$ sudo fdisk /dev/sdb

# 2. 查看当前分区表
Command (m for help): p

# 3. 创建新分区
Command (m for help): n

# 4. 选择分区类型
Partition type:
   p   primary (主分区)
   e   extended (扩展分区)
Select (default p): p

# 5. 选择分区号
Partition number (1-4, default 1): 1

# 6. 设置起始扇区（通常用默认值）
First sector: [直接回车用默认值]

# 7. 设置结束扇区或分区大小
Last sector: +10G  ← 创建10GB分区

# 8. 保存更改
Command (m for help): w
```

**🎯 实用技巧**：

| 命令技巧 | **含义** | **示例** |
|---------|---------|---------|
| `+10G` | `创建10GB分区` | `Last sector: +10G` |
| `+500M` | `创建500MB分区` | `Last sector: +500M` |
| `直接回车` | `使用剩余全部空间` | `Last sector: [回车]` |

### 2.5 分区类型标识符


**🏷️ 常用分区类型**：

```
主要分区类型代码：
83 = Linux 普通分区
82 = Linux swap 交换分区
8e = Linux LVM 分区
07 = NTFS (Windows分区)
0c = FAT32 分区
ef = EFI 系统分区

修改分区类型示例：
Command (m for help): t
Partition number (1-4): 2
Hex code: 82  ← 设置为swap分区
```

### 2.6 fdisk高级功能


**🔍 查看磁盘信息**：

```bash
# 列出所有磁盘和分区详细信息
fdisk -l

# 查看特定磁盘信息
fdisk -l /dev/sda

# 以扇区为单位显示
fdisk -u /dev/sda
```

**📊 输出信息解读**：

```
示例输出：
Disk /dev/sda: 500.1 GB
Device     Boot Start      End  Sectors  Size Id Type
/dev/sda1  *     2048  1050623  1048576  512M 83 Linux
/dev/sda2     1052670 104857599 103804930 49.5G 8e Linux LVM

解读说明：
Boot = 启动标志（*表示可启动）
Start/End = 起始/结束扇区号
Sectors = 扇区数量
Size = 分区大小
Id = 分区类型代码
Type = 分区类型描述
```

---

## 3. 🔄 gdisk命令详解


### 3.1 gdisk基本概念


**gdisk是什么？** 它是专门处理GPT分区表的工具，可以理解为fdisk的"现代化升级版"。如果说fdisk是传统的建筑设计师，那gdisk就是使用最新技术的建筑师。

**🆚 gdisk vs fdisk**：
- **fdisk**：只支持MBR，最大2TB，最多4个主分区
- **gdisk**：专门支持GPT，几乎无限容量，最多128个分区

### 3.2 gdisk交互命令


**📋 gdisk专用命令**（与fdisk类似但有区别）：

```
信息查看：
p  ← 打印分区表
i  ← 显示详细分区信息

分区操作：
n  ← 新建分区
d  ← 删除分区
t  ← 更改分区类型

高级功能：
r  ← 进入恢复/转换菜单
x  ← 进入专家模式

保存退出：
w  ← 写入更改
q  ← 退出不保存
```

### 3.3 gdisk实际操作


**🛠️ 创建GPT分区示例**：

```bash
# 1. 进入gdisk
$ sudo gdisk /dev/sdc

# 2. 查看当前状态
Command (? for help): p

# 3. 创建新分区
Command (? for help): n

# 4. 分区号（直接回车用默认）
Partition number (1-128, default 1): [回车]

# 5. 起始扇区（用默认值）
First sector: [回车]

# 6. 结束扇区或大小
Last sector: +20G

# 7. 分区类型（默认是Linux filesystem）
Hex code or GUID: [回车]

# 8. 保存
Command (? for help): w
```

### 3.4 GPT分区类型代码


**🏷️ 常用GPT分区类型**：

| 代码 | **类型** | **用途** |
|------|---------|---------|
| `8300` | `Linux filesystem` | `普通Linux分区` |
| `8200` | `Linux swap` | `交换分区` |
| `8e00` | `Linux LVM` | `LVM逻辑卷` |
| `ef00` | `EFI System` | `EFI启动分区` |
| `0700` | `Microsoft basic data` | `Windows数据分区` |

### 3.5 gdisk高级功能


**🔧 分区表转换**：

```bash
# MBR转GPT（需要进入恢复模式）
$ sudo gdisk /dev/sda
Command (? for help): r  # 进入恢复菜单
Recovery (? for help): g  # 将MBR转换为GPT
Recovery (? for help): w  # 保存更改
```

**⚠️ 转换注意事项**：
- 转换前务必备份重要数据
- 确保系统支持GPT启动（需要UEFI）
- 转换过程不可逆，谨慎操作

---

## 4. 🎛️ parted命令详解


### 4.1 parted基本概念


**parted是什么？** 它是一个"全能型"分区工具，既能处理MBR也能处理GPT，就像一个同时精通传统和现代技术的专家。parted还支持命令行直接操作，不需要进入交互模式。

**🌟 parted特点**：
- ✅ **通用性强**：支持MBR和GPT两种分区表
- ✅ **即时生效**：操作立即写入磁盘（无需保存）
- ✅ **脚本友好**：支持非交互式操作
- ⚠️ **操作即时**：没有"保存"步骤，操作需谨慎

### 4.2 parted基本语法


**📝 命令格式**：

```bash
# 基本格式
parted [选项] 设备 [命令]

# 进入交互模式
parted /dev/sda

# 直接执行命令（非交互）
parted /dev/sda print
```

### 4.3 parted常用命令


**📋 核心命令清单**：

```
信息查看：
print         ← 显示分区表
print all     ← 显示所有设备分区信息
print free    ← 显示空闲空间

分区表管理：
mklabel gpt   ← 创建GPT分区表
mklabel msdos ← 创建MBR分区表

分区操作：
mkpart        ← 创建分区
rm            ← 删除分区
resizepart    ← 调整分区大小

其他：
quit          ← 退出
help          ← 帮助
```

### 4.4 parted实际操作示例


**🛠️ 完整分区创建流程**：

```bash
# 1. 查看当前分区表
$ sudo parted /dev/sdd print

# 2. 创建GPT分区表（如果需要）
$ sudo parted /dev/sdd mklabel gpt

# 3. 创建主分区（Linux文件系统）
$ sudo parted /dev/sdd mkpart primary ext4 1MiB 10GiB

# 4. 创建交换分区
$ sudo parted /dev/sdd mkpart primary linux-swap 10GiB 12GiB

# 5. 查看结果
$ sudo parted /dev/sdd print
```

**💡 mkpart命令详解**：

```
命令格式：
mkpart [分区类型] [文件系统] [起始位置] [结束位置]

参数说明：
分区类型：primary（主分区）、extended（扩展分区）、logical（逻辑分区）
文件系统：ext4、xfs、ntfs、fat32、linux-swap等
位置单位：MiB、GiB、MB、GB、%（百分比）

实用示例：
mkpart primary ext4 0% 50%        ← 使用磁盘的前50%
mkpart primary ext4 1MiB 100%     ← 从1MiB开始到磁盘末尾
mkpart primary linux-swap 8GiB 10GiB ← 创建2GB交换分区
```

### 4.5 parted高级操作


**📏 分区大小调整**：

```bash
# 查看当前分区编号和大小
$ sudo parted /dev/sda print

# 调整分区2的大小到20GB
$ sudo parted /dev/sda resizepart 2 20GiB

# ⚠️ 注意：只调整分区大小，文件系统需要单独调整
$ sudo resize2fs /dev/sda2  # 对于ext4文件系统
```

**🔍 空间分析**：

```bash
# 显示详细的空闲空间信息
$ sudo parted /dev/sda print free

# 输出示例：
Model: ATA TOSHIBA DT01ACA1 (scsi)
Disk /dev/sda: 1000GB
Number  Start   End     Size    File system     Name  Flags
        17.4kB  1049kB  1031kB  Free Space
 1      1049kB  525MB   524MB   fat32                 boot, esp
        525MB   1000GB  1000GB  Free Space           ← 可用空间
```

**📋 批量操作脚本**：

```bash
#!/bin/bash
# 自动分区脚本示例

DEVICE="/dev/sdb"

# 创建GPT分区表
parted $DEVICE mklabel gpt

# 创建EFI分区
parted $DEVICE mkpart ESP fat32 1MiB 513MiB
parted $DEVICE set 1 esp on

# 创建根分区
parted $DEVICE mkpart primary ext4 513MiB 50GiB

# 创建home分区
parted $DEVICE mkpart primary ext4 50GiB 100%

echo "分区创建完成！"
parted $DEVICE print
```

---

## 5. 🖥️ 图形化分区工具


### 5.1 cfdisk - 文本图形界面


**cfdisk是什么？** 它是fdisk的"图形化"版本，虽然仍在终端中运行，但提供了类似图形界面的操作体验，就像从命令行界面升级到了"半图形"界面。

**🎯 cfdisk优势**：
- 📱 **直观操作**：菜单驱动，容易上手
- ⌨️ **快捷键**：支持方向键和快捷键操作
- 👀 **可视化**：分区信息一目了然

**🚀 cfdisk基本使用**：

```bash
# 启动cfdisk
sudo cfdisk /dev/sda

# 界面操作说明：
↑↓  ← 选择分区
←→  ← 选择底部菜单项
Tab ← 在分区列表和菜单间切换
Enter ← 执行选中的操作

# 底部菜单选项：
[New]    ← 创建新分区
[Delete] ← 删除分区
[Type]   ← 更改分区类型
[Write]  ← 保存更改到磁盘
[Quit]   ← 退出程序
```

**💡 cfdisk操作提示**：

```
界面布局示例：
┌─────────────────────────────────────────────┐
│    设备: /dev/sda [磁盘大小: 500GB]          │
├─────────────────────────────────────────────┤
│  分区   起始      大小    类型       标志    │
│  sda1   2048     512M    EFI System  Boot   │
│  sda2   1050624   49G    Linux       -      │
│  空闲   -        450G    -           -      │
└─────────────────────────────────────────────┘
  [New] [Delete] [Type] [Write] [Quit]

操作流程：
1. 用↑↓键选择要操作的分区或空闲空间
2. 用←→键选择底部的操作菜单
3. 按Enter执行操作
4. 所有操作完成后选择[Write]保存
```

### 5.2 sfdisk - 脚本化分区工具


**sfdisk是什么？** 它是专为**自动化脚本**设计的分区工具，就像一个"分区机器人"，可以按照预设的"程序"自动完成分区工作。

**🤖 sfdisk特点**：
- 📜 **脚本友好**：专为批量操作设计
- 🔄 **可重复**：相同脚本可多次执行
- 💾 **可备份**：分区表可以导出和导入

**📝 sfdisk基本语法**：

```bash
# 查看分区表
sfdisk -l /dev/sda

# 备份分区表
sfdisk -d /dev/sda > partition_backup.txt

# 恢复分区表
sfdisk /dev/sda < partition_backup.txt

# 使用脚本创建分区
echo "分区定义" | sfdisk /dev/sda
```

**🛠️ sfdisk脚本示例**：

```bash
# 创建分区脚本文件：partition_script.txt
label: gpt
unit: sectors

/dev/sda1 : start=2048, size=1048576, type=C12A7328-F81F-11D2-BA4B-00A0C93EC93B
/dev/sda2 : start=1050624, size=104857600, type=0FC63DAF-8483-4772-8E79-3D69D8477DE4
/dev/sda3 : start=105908224, type=0657FD6D-A4AB-43C4-84E5-0933C84B4F4F

# 执行脚本
sudo sfdisk /dev/sda < partition_script.txt
```

**💡 脚本参数说明**：

| 参数 | **含义** | **示例** |
|------|---------|---------|
| `label` | `分区表类型` | `gpt` 或 `dos` |
| `unit` | `大小单位` | `sectors`、`MiB`、`GiB` |
| `start` | `起始位置` | `2048`（扇区号） |
| `size` | `分区大小` | `1048576`（扇区数） |
| `type` | `分区类型` | `GUID或类型代码` |

---

## 6. 🔄 高级分区管理技巧


### 6.1 partprobe - 重新读取分区表


**partprobe是什么？** 当你修改了分区表后，系统可能还在使用旧的分区信息，partprobe就像一个"刷新按钮"，告诉系统重新识别最新的分区情况。

**🔄 为什么需要partprobe？**

```
问题场景：
1. 用fdisk创建了新分区
2. 查看/dev/目录，发现新分区设备文件不存在
3. 尝试格式化新分区时报"设备不存在"错误

解决方案：
$ sudo partprobe /dev/sda  ← 重新读取sda的分区表
$ ls /dev/sda*             ← 查看是否出现新分区
```

**⚡ partprobe使用方法**：

```bash
# 重新读取指定磁盘的分区表
sudo partprobe /dev/sda

# 重新读取所有磁盘的分区表
sudo partprobe

# 显示详细信息
sudo partprobe -s /dev/sda
```

**💡 实用技巧**：

```bash
# 分区后的标准操作流程
sudo fdisk /dev/sda      # 创建分区
sudo partprobe /dev/sda  # 刷新分区表
lsblk                    # 查看分区是否识别
sudo mkfs.ext4 /dev/sda1 # 格式化新分区
```

### 6.2 分区对齐优化


**什么是分区对齐？** 就像停车时要对准车位线一样，分区也需要对准硬盘的物理结构，这样可以获得最佳性能。

**📏 对齐的重要性**：
- ⚡ **性能提升**：避免跨越物理边界的读写
- 🔧 **SSD优化**：延长SSD使用寿命
- 📊 **效率提高**：减少不必要的I/O操作

**🎯 对齐设置技巧**：

```bash
# fdisk中设置对齐（推荐使用默认值）
Command (m for help): n
First sector (2048-...): [直接回车，使用默认值]
# fdisk会自动选择对齐的起始位置

# parted中确保对齐
sudo parted /dev/sda mkpart primary ext4 1MiB 10GiB
# 使用MiB为单位通常能确保正确对齐

# 检查分区是否对齐
sudo parted /dev/sda align-check optimal 1
# 输出：1 aligned 表示分区1已正确对齐
```

**📋 对齐检查工具**：

```bash
# 查看磁盘的对齐参数
sudo fdisk -l /dev/sda
# 查看 "Sector size" 和 "I/O size" 信息

# 使用parted检查对齐
sudo parted /dev/sda print
# 查看是否有对齐警告信息
```

### 6.3 分区表备份与恢复


**🛡️ 为什么要备份分区表？**
分区表是硬盘的"目录册"，一旦损坏，所有数据都可能无法访问。备份分区表就像给重要文档做复印件一样重要。

**💾 MBR分区表备份**：

```bash
# 备份整个MBR（包含分区表和启动代码）
sudo dd if=/dev/sda of=mbr_backup.bin bs=512 count=1

# 只备份分区表部分（不含启动代码）
sudo sfdisk -d /dev/sda > partition_table_backup.txt

# 恢复MBR
sudo dd if=mbr_backup.bin of=/dev/sda bs=512 count=1

# 恢复分区表
sudo sfdisk /dev/sda < partition_table_backup.txt
```

**📁 GPT分区表备份**：

```bash
# 使用sgdisk备份GPT
sudo sgdisk --backup=gpt_backup.sgdisk /dev/sda

# 恢复GPT分区表
sudo sgdisk --load-backup=gpt_backup.sgdisk /dev/sda

# 使用gdisk查看备份内容
sudo gdisk -l gpt_backup.sgdisk
```

**📋 分区信息导出**：

```bash
# 导出详细的分区信息
lsblk -o NAME,SIZE,TYPE,FSTYPE,MOUNTPOINT /dev/sda > partition_info.txt
sudo blkid /dev/sda* >> partition_info.txt
sudo parted /dev/sda print >> partition_info.txt
```

### 6.4 分区错误修复


**🚨 常见分区问题及解决方案**：

**问题1：分区表损坏**

```bash
# 症状：fdisk -l 显示错误信息
# 解决：使用testdisk工具修复

sudo apt install testdisk  # 安装testdisk
sudo testdisk              # 启动修复工具

# testdisk使用步骤：
1. 选择磁盘
2. 选择分区表类型（Intel/PC或EFI GPT）
3. 选择 "Analyse" 分析分区
4. 选择 "Search" 搜索丢失分区
5. 确认找到的分区后选择 "Write" 写入
```

**问题2：分区无法识别**

```bash
# 强制内核重新读取分区表
sudo partprobe /dev/sda
sudo kpartx -a /dev/sda  # 对于某些特殊情况

# 重启udev服务
sudo systemctl restart systemd-udevd

# 检查内核消息
dmesg | grep -i "partition\|sda"
```

**问题3：分区重叠或冲突**

```bash
# 使用parted检查分区完整性
sudo parted /dev/sda print

# 如果发现重叠，需要重新调整分区边界
sudo parted /dev/sda resizepart 2 10GiB  # 调整分区2到10GB
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 分区本质：将物理硬盘分割成逻辑区域进行独立管理
🔸 分区表类型：MBR（传统，≤2TB）vs GPT（现代，大容量）
🔸 工具选择：fdisk(MBR) + gdisk(GPT) + parted(通用)
🔸 操作安全：备份数据 → 操作分区 → 刷新分区表 → 验证结果
🔸 分区对齐：使用工具默认值，确保最佳性能
```

### 7.2 工具选择指南


**🎯 根据需求选择工具**：

| 使用场景 | **推荐工具** | **理由** |
|---------|-------------|---------|
| 🆕 **新手学习** | `cfdisk` | `图形化界面，操作直观` |
| 🔧 **MBR分区** | `fdisk` | `经典工具，功能完善` |
| 🚀 **GPT分区** | `gdisk` | `专门支持GPT特性` |
| 🎛️ **通用操作** | `parted` | `支持所有分区表类型` |
| 🤖 **自动化脚本** | `sfdisk` | `脚本友好，批量操作` |

### 7.3 关键操作流程


**📝 标准分区创建流程**：

```
1️⃣ 准备阶段：
   ├─ 备份重要数据
   ├─ 确认目标磁盘：lsblk
   └─ 选择分区表类型：MBR或GPT

2️⃣ 分区阶段：
   ├─ 启动分区工具：fdisk/gdisk/parted
   ├─ 创建分区表：mklabel
   ├─ 创建分区：mkpart/n命令
   └─ 设置分区类型：type命令

3️⃣ 完成阶段：
   ├─ 保存更改：w命令
   ├─ 刷新分区表：partprobe
   ├─ 验证结果：lsblk/fdisk -l
   └─ 格式化分区：mkfs.ext4
```

### 7.4 实用记忆技巧


**🧠 命令记忆口诀**：

```
fdisk操作记心间：
p查看，n新建，d删除
t类型，w保存，q退出

parted功能全又强：
print查看，mkpart建分区
mklabel建表，rm删除忙

分区对齐很重要：
起始扇区用默认
MiB单位最保险
```

**⚠️ 安全注意事项**：

- 🛡️ **数据备份**：分区前务必备份重要数据
- 🔍 **仔细确认**：确保操作的是正确磁盘
- ⚡ **及时刷新**：分区后使用partprobe刷新
- 📋 **详细记录**：记录分区方案便于后续维护

### 7.5 故障排除要点


**🚨 常见问题处理**：

```
❓ 问题：新分区不显示
✅ 解决：sudo partprobe /dev/sda

❓ 问题：分区表类型选择
✅ 解决：大硬盘(>2TB)用GPT，小硬盘可用MBR

❓ 问题：分区无法格式化
✅ 解决：检查分区是否被挂载，umount后再试

❓ 问题：分区性能不佳
✅ 解决：检查分区对齐，重新创建对齐的分区
```

**核心记忆**：
- 分区管理需谨慎，备份数据是关键
- 工具选择看需求，MBR用fdisk，GPT用gdisk
- parted功能最全面，脚本自动用sfdisk
- 操作完成别忘记，partprobe刷新是必须