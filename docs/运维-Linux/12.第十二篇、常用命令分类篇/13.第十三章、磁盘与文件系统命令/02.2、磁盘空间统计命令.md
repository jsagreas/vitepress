---
title: 2、磁盘空间统计命令
---
## 📚 目录

1. [磁盘空间查看基础](#1-磁盘空间查看基础)
2. [df命令详解](#2-df命令详解)
3. [du命令详解](#3-du命令详解)
4. [ncdu交互式工具](#4-ncdu交互式工具)
5. [文件大小查看](#5-文件大小查看)
6. [实用技巧与最佳实践](#6-实用技巧与最佳实践)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔍 磁盘空间查看基础


### 1.1 为什么需要监控磁盘空间


**现实场景理解**：就像你需要知道手机存储空间一样，Linux系统也需要时刻了解磁盘使用情况

```
日常管理需求：
📱 手机：设置 → 存储空间 → 查看剩余空间
💻 Linux：使用专门的命令查看磁盘使用情况

常见问题：
- 系统运行缓慢 → 可能磁盘空间不足
- 无法保存文件 → 磁盘可能已满
- 日志文件过大 → 需要定期清理
```

### 1.2 磁盘空间概念区分


**🔸 文件系统 vs 磁盘分区**
```
物理概念：
硬盘 → 分区 → 文件系统 → 目录/文件

实际对应：
/dev/sda1 (物理分区) → ext4文件系统 → 挂载到 /home
/dev/sda2 (物理分区) → ext4文件系统 → 挂载到 /

简单理解：
- 硬盘是整块蛋糕
- 分区是切好的蛋糕块
- 文件系统是装蛋糕的盒子格式
- 挂载点是放盒子的位置
```

### 1.3 空间统计的两个维度


**数据空间 vs inode空间**
```
数据空间：存储文件内容的实际空间
- 一个1MB的图片占用1MB数据空间
- 就像书的页数，内容越多占用越大

inode空间：存储文件信息的索引空间  
- 每个文件都需要一个inode记录信息
- 就像图书馆的目录卡片，不管书多厚都只要一张卡片

实际问题：
- 数据空间满了：无法保存大文件
- inode空间满了：无法创建新文件（哪怕很小）
```

---

## 2. 📊 df命令详解


### 2.1 df命令基本概念


**🔸 df = disk free（磁盘空闲）**
```
核心作用：显示文件系统级别的磁盘空间使用情况
工作原理：查询每个挂载点的空间统计信息
适用场景：快速了解系统整体磁盘使用状况

类比理解：
df命令 = 查看各个房间的使用情况
- 客厅用了多少空间
- 卧室还剩多少空间  
- 厨房使用率多高
```

### 2.2 df基础用法


**基本语法**：`df [选项] [文件系统]`

```bash
# 最基本用法 - 显示所有文件系统
df

# 输出示例（数字单位为KB）
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/sda1       20641404 3456789  15678901  18% /
/dev/sda2       51203640 8901234  39876543  19% /home
```

**字段含义解释**：
- **Filesystem**: 文件系统名称（通常是设备名）
- **1K-blocks**: 总容量（以1K为单位）
- **Used**: 已使用空间
- **Available**: 可用空间
- **Use%**: 使用百分比
- **Mounted on**: 挂载点（在系统中的位置）

### 2.3 df -h：人性化显示


**🔸 -h参数详解**
```bash
# -h = --human-readable（人类可读格式）
df -h

# 输出示例
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        20G  3.3G   15G  18% /
/dev/sda2        49G  8.5G   38G  19% /home
tmpfs           2.0G     0  2.0G   0% /dev/shm
```

**单位自动转换**：
- **B** = Bytes（字节）
- **K** = KB（千字节）= 1024 B
- **M** = MB（兆字节）= 1024 KB  
- **G** = GB（吉字节）= 1024 MB
- **T** = TB（太字节）= 1024 GB

**实用性对比**：
```
不使用-h：20641404 KB → 需要心算转换
使用-h：  20G        → 一目了然
```

### 2.4 df -i：inode使用情况


**🔸 什么是inode**
```
inode = index node（索引节点）
作用：存储文件的元信息（不是文件内容）

包含信息：
- 文件大小
- 创建时间、修改时间
- 文件权限
- 文件所有者
- 文件类型
- 数据块位置信息

简单类比：
文件内容 = 书的内容
inode = 图书馆的登记卡片
```

```bash
# 查看inode使用情况
df -i

# 输出示例
Filesystem      Inodes   IUsed   IFree IUse% Mounted on
/dev/sda1      1310720   45678 1265042    4% /
/dev/sda2      3276800  123456 3153344    4% /home
```

**字段含义**：
- **Inodes**: 总inode数量
- **IUsed**: 已使用的inode数量
- **IFree**: 空闲inode数量  
- **IUse%**: inode使用百分比

**实际应用场景**：
```bash
# 场景1：大量小文件导致inode耗尽
# 现象：磁盘空间充足，但无法创建新文件
df -h    # 显示空间充足
df -i    # 显示inode使用率100%

# 场景2：找出inode使用率高的文件系统
df -i | grep -v "0%" | sort -k5 -r
```

### 2.5 df命令其他常用选项


**指定文件系统类型**：
```bash
# 只显示ext4文件系统
df -t ext4 -h

# 排除临时文件系统
df -x tmpfs -x devtmpfs -h
```

**指定特定目录**：
```bash
# 查看特定目录所在文件系统的使用情况
df -h /home
df -h /var/log

# 只显示本地文件系统（排除网络挂载）
df -l -h
```

---

## 3. 📁 du命令详解


### 3.1 du命令基本概念


**🔸 du = disk usage（磁盘使用量）**
```
核心作用：统计目录或文件的实际磁盘占用量
工作方式：递归计算指定路径下所有文件的大小总和
与df区别：
- df：看整个文件系统的空间情况
- du：看具体目录/文件的占用情况

生活类比：
df = 看整个仓库有多少货架，用了多少
du = 看具体某个货架上的货物有多重
```

### 3.2 du基础用法


```bash
# 最基本用法 - 显示当前目录及子目录大小
du

# 输出示例（默认以KB为单位）
4       ./empty_dir
1028    ./documents  
2048    ./pictures
512     ./scripts
3592    .
```

**默认行为特点**：
- 显示每个子目录的大小
- 最后一行显示总大小
- 单位默认为KB
- 递归统计所有子目录

### 3.3 du -sh：汇总显示目录大小


**🔸 -s参数：summarize（汇总）**
```bash
# 只显示总大小，不显示子目录详情
du -s /home/user
# 输出：1048576    /home/user

# 结合-h参数，人性化显示
du -sh /home/user  
# 输出：1.0G    /home/user
```

**参数组合解释**：
- **-s**: 只显示汇总结果
- **-h**: 人性化单位显示
- **组合使用**: 最常用的du命令形式

**实际应用场景**：
```bash
# 快速查看用户主目录大小
du -sh ~

# 检查各个重要目录的大小
du -sh /var/log /tmp /opt

# 查看当前目录下各个子目录的大小  
du -sh */ 
```

### 3.4 du -h --max-depth：指定深度显示


**🔸 控制统计深度**
```bash
# 只显示当前目录下一级子目录的大小
du -h --max-depth=1

# 输出示例
4.0K    ./empty_dir
1.0M    ./documents
2.0M    ./pictures  
512K    ./scripts
3.5M    .
```

**深度参数说明**：
- **--max-depth=1**: 只显示一级子目录
- **--max-depth=2**: 显示到二级子目录
- **--max-depth=0**: 等同于 `-s`，只显示总计

**实用场景展示**：
```bash
# 分析根目录下各个主要目录的大小
sudo du -h --max-depth=1 /

# 输出可能类似：
# 0       /proc
# 4.0K    /mnt  
# 16K     /root
# 1.2G    /usr
# 500M    /var
# 2.1G    /home
# 4.2G    /
```

### 3.5 du命令实用技巧


**找出最大的目录**：
```bash
# 找出当前目录下最大的5个子目录
du -sh */ | sort -hr | head -5

# 命令解释：
# du -sh */        获取所有子目录大小
# sort -hr         按大小降序排序（-h识别单位，-r反向）
# head -5          显示前5个
```

**排除特定目录**：
```bash
# 排除.git目录统计项目大小
du -sh --exclude=.git project/

# 排除多个目录
du -sh --exclude=node_modules --exclude=.git project/
```

**查找大文件**：
```bash
# 找出大于100M的目录
du -h | grep -E '^[0-9.]+G|^[5-9][0-9][0-9]M'
```

---

## 4. 🖥️ ncdu交互式工具


### 4.1 ncdu工具简介


**🔸 ncdu = NCurses Disk Usage**
```
工具定位：基于文本界面的交互式磁盘使用量分析工具
核心优势：可视化显示 + 交互式操作
安装方式：
# Ubuntu/Debian
sudo apt install ncdu

# CentOS/RHEL  
sudo yum install ncdu
```

### 4.2 ncdu基本使用


```bash
# 分析当前目录
ncdu

# 分析指定目录
ncdu /home

# 分析时排除某些目录
ncdu --exclude /proc --exclude /sys /
```

**界面功能说明**：
```
ncdu 界面布局：
┌─────────────────────────────────────┐
│ /home/user                     1.2G │ ← 当前路径和总大小
├─────────────────────────────────────┤
│  800.0M documents/              66% │ ← 目录大小和占比
│  300.0M pictures/               25% │
│   80.0M videos/                  7% │
│   20.0M scripts/                 2% │
├─────────────────────────────────────┤
│ Total disk usage: 1.2G              │ ← 统计信息
└─────────────────────────────────────┘
```

**交互式按键操作**：
- **回车键**: 进入选中的目录
- **左箭头**: 返回上级目录  
- **d键**: 删除选中的文件/目录
- **r键**: 刷新当前目录统计
- **q键**: 退出程序
- **?键**: 显示帮助信息

### 4.3 ncdu实用场景


**磁盘空间清理**：
```
使用流程：
1. ncdu /                    # 从根目录开始分析
2. 找到占用空间最大的目录
3. 进入该目录继续分析  
4. 找到可以清理的文件
5. 按'd'键直接删除

优势：可视化 + 即时操作，效率很高
```

**定期空间监控**：
```bash
# 创建定期检查脚本
#!/bin/bash
echo "系统磁盘使用分析报告 - $(date)"
echo "=================================="
ncdu --one-file-system /home > /tmp/disk_usage.txt
echo "详细报告已保存到 /tmp/disk_usage.txt"
```

---

## 5. 📄 文件大小查看


### 5.1 ls -lh命令详解


**🔸 ls命令的文件大小显示**
```bash
# 基本的长格式显示
ls -l

# 输出示例
-rw-r--r-- 1 user user 1048576 Jan 15 10:30 document.pdf
-rw-r--r-- 1 user user    2048 Jan 15 11:45 config.txt

# 人性化大小显示
ls -lh

# 输出示例  
-rw-r--r-- 1 user user 1.0M Jan 15 10:30 document.pdf
-rw-r--r-- 1 user user 2.0K Jan 15 11:45 config.txt
```

**字段含义说明**：
```
-rw-r--r-- 1 user user 1.0M Jan 15 10:30 document.pdf
│          │ │    │    │    │            └─ 文件名
│          │ │    │    │    └─ 修改时间
│          │ │    │    └─ 文件大小
│          │ │    └─ 文件所属组
│          │ └─ 文件所有者  
│          └─ 硬链接数
└─ 文件权限
```

### 5.2 按文件大小排序


**不同排序方式**：
```bash
# 按文件大小从大到小排序
ls -lhS

# 按文件大小从小到大排序  
ls -lhSr

# 按修改时间排序（最新的在前）
ls -lht

# 组合使用：按大小排序并显示详细信息
ls -lhS --color=always | head -10
```

### 5.3 查看特定类型文件大小


```bash
# 只显示普通文件的大小
ls -lh | grep "^-"

# 显示所有图片文件大小
ls -lh *.jpg *.png *.gif 2>/dev/null

# 找出最大的文件
ls -lhS | head -5
```

---

## 6. 🛠️ 实用技巧与最佳实践


### 6.1 磁盘空间监控策略


**🔸 建立监控体系**
```bash
# 1. 每日检查脚本
#!/bin/bash
echo "=== 磁盘空间监控报告 $(date) ==="

# 检查整体磁盘使用情况
echo "整体磁盘使用情况："
df -h | grep -E '^/dev/'

echo ""
echo "inode使用情况："  
df -i | grep -E '^/dev/' | awk '$5+0 > 80 {print "警告: " $1 " inode使用率 " $5}'

# 检查大目录
echo ""
echo "占用空间最大的目录："
du -sh /var/* /home/* /opt/* 2>/dev/null | sort -hr | head -5
```

### 6.2 空间清理最佳实践


**安全清理流程**：
```
第一步：识别问题
df -h                    # 确认哪个分区空间不足

第二步：定位大文件/目录
du -sh /* | sort -hr    # 找出根目录下最大的目录
ncdu /var/log           # 交互式分析日志目录

第三步：安全清理
# 清理日志文件（保留最近7天）
find /var/log -name "*.log" -mtime +7 -exec rm {} \;

# 清理临时文件
sudo rm -rf /tmp/*
sudo rm -rf /var/tmp/*

# 清理包管理器缓存
sudo apt clean        # Ubuntu/Debian
sudo yum clean all     # CentOS/RHEL
```

### 6.3 预防性维护


**设置空间警告**：
```bash
# 添加到crontab中，每小时检查一次
0 * * * * df -h | awk '$5+0 > 90 {print "警告: " $1 " 使用率达到 " $5}' | mail -s "磁盘空间警告" admin@company.com
```

**日志轮转设置**：
```bash
# 配置logrotate防止日志文件过大
sudo vim /etc/logrotate.conf

# 确保有如下配置：
/var/log/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
}
```

### 6.4 常见问题解决


| **问题现象** | **可能原因** | **检查命令** | **解决方案** |
|-------------|-------------|-------------|-------------|
| 磁盘空间不足但找不到大文件 | 删除的文件还在被进程使用 | `lsof +L1` | 重启相关进程 |
| 无法创建文件但空间充足 | inode用尽 | `df -i` | 删除不需要的小文件 |
| 系统突然变慢 | 磁盘空间接近满 | `df -h` | 清理空间或扩容 |
| 日志文件过大 | 日志轮转未配置 | `ls -lh /var/log/` | 配置logrotate |

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心命令


```
🔸 df -h     ：查看文件系统空间使用情况，人性化显示
🔸 df -i     ：查看inode使用情况，防止文件数量过多
🔸 du -sh    ：查看目录总大小，快速定位空间占用
🔸 du -h --max-depth=1：查看各子目录大小，分层分析
🔸 ncdu      ：交互式磁盘分析工具，可视化操作
🔸 ls -lh    ：查看文件详细大小信息
```

### 7.2 关键理解要点


**🔹 df vs du的本质区别**
```
df（文件系统级别）：
- 查看整个分区的空间情况
- 关注可用空间和使用率
- 类似查看整个仓库的容量

du（目录文件级别）：  
- 查看具体目录的空间占用
- 关注哪些目录占用空间大
- 类似查看仓库里具体货物的重量
```

**🔹 数据空间 vs inode空间**
```
数据空间：存文件内容，大文件占用多
inode空间：存文件信息，小文件消耗多

实际问题：
- 数据空间满：清理大文件
- inode空间满：删除多余小文件
```

**🔹 人性化显示的重要性**
```
-h参数的价值：
不使用：20641404（需要心算）
使用-h：20G（一目了然）

在运维工作中，-h参数几乎是必需的
```

### 7.3 实际应用指导


**日常监控流程**：
```
1. df -h        # 快速检查整体空间情况
2. df -i        # 检查inode使用情况  
3. du -sh /*    # 找出占用空间最大的目录
4. ncdu 大目录   # 交互式详细分析
5. 清理或扩容    # 根据分析结果采取行动
```

**问题排查思路**：
```
磁盘空间问题 → df -h 确认哪个分区
            ↓
            du -sh /* 找出大目录
            ↓  
            ncdu 详细分析
            ↓
            制定清理策略
```

**最佳实践原则**：
- **预防为主**：定期监控，避免空间耗尽
- **安全第一**：清理前备份重要数据
- **分析再行动**：先分析后清理，避免误删
- **自动化监控**：设置脚本和告警机制

### 7.4 记忆要点


**核心命令记忆**：
```
df看分区，du看目录
-h要记住，人性显示
-s是汇总，-i看索引节点
ncdu交互强，空间清理帮手
```

**应用场景记忆**：
- **df -h**: 日常检查，快速了解空间情况
- **du -sh**: 找大目录，定位空间占用源头  
- **ncdu**: 深度分析，交互式清理空间
- **ls -lh**: 查文件，了解具体文件大小

**故障排查记忆**：
- 空间不足先df，定位问题分区
- 找大目录用du，一级一级往下查
- inode满了df -i，删小文件来解决
- 进程占用lsof查，重启进程释放空间