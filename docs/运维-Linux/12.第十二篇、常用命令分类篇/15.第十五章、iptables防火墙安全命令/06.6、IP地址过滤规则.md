---
title: 6、IP地址过滤规则
---
## 📚 目录

1. [IP地址过滤基础概念](#1-IP地址过滤基础概念)
2. [源IP地址过滤(-s参数)](#2-源IP地址过滤-s参数)
3. [目标IP地址过滤(-d参数)](#3-目标IP地址过滤-d参数)
4. [IP地址段CIDR表示法](#4-IP地址段CIDR表示法)
5. [地址范围模块(-m iprange)](#5-地址范围模块-m-iprange)
6. [取反操作符(!)使用](#6-取反操作符使用)
7. [多IP地址组合过滤](#7-多IP地址组合过滤)
8. [本地IP地址识别技巧](#8-本地IP地址识别技巧)
9. [实用案例与最佳实践](#9-实用案例与最佳实践)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🌐 IP地址过滤基础概念


### 1.1 什么是IP地址过滤


**🔸 通俗理解**
想象一下，你家门口有个保安，他需要检查每个想进入的人的身份证。IP地址过滤就像这个保安，它检查每个网络数据包的"身份证"（IP地址），决定是否让这个数据包通过。

**🔸 专业定义**
IP地址过滤是iptables防火墙根据数据包的源IP地址或目标IP地址来决定是否允许、拒绝或丢弃该数据包的机制。

**🔸 为什么需要IP地址过滤**
```
现实应用场景：
📍 公司网络：只允许员工IP访问内部服务器
📍 网站安全：阻止恶意IP地址的攻击
📍 地域限制：只允许特定国家的IP访问
📍 访问控制：VIP用户享有特殊访问权限
```

### 1.2 数据包的IP地址构成


**🔸 数据包的"身份信息"**
```
每个网络数据包都携带两个重要的IP地址：

┌─────────────────────────────────────┐
│           数据包结构                 │
├─────────────────────────────────────┤
│ 源IP地址(Source IP)  → 发送方地址    │
│ 目标IP地址(Dest IP)  → 接收方地址    │
│ 其他信息...                         │
└─────────────────────────────────────┘

就像寄信一样：
源IP = 寄信人地址
目标IP = 收信人地址
```

**🔸 过滤方向说明**
- **`-s`参数**：过滤源IP地址（数据从哪里来）
- **`-d`参数**：过滤目标IP地址（数据要到哪里去）

---

## 2. 📤 源IP地址过滤(-s参数)


### 2.1 -s参数基本用法


**🔸 基本语法**
```bash
iptables -A INPUT -s <IP地址> -j <动作>
```

**🔸 通俗解释**
`-s`就是"source"（源头）的缩写，用来指定"这个规则只针对从某个IP地址发来的数据包生效"。

### 2.2 单个IP地址过滤


**🔸 实用示例**
```bash
# 允许来自192.168.1.100的所有连接
iptables -A INPUT -s 192.168.1.100 -j ACCEPT

# 拒绝来自10.0.0.50的所有连接
iptables -A INPUT -s 10.0.0.50 -j DROP

# 阻止来自恶意IP的SSH连接
iptables -A INPUT -s 192.168.1.200 -p tcp --dport 22 -j REJECT
```

**🔸 生活化理解**
```
场景对比：
🏠 门卫检查：只有张三的工牌能进公司大门
💻 防火墙：只有192.168.1.100这个IP能访问我的服务器

两者本质相同：根据"身份标识"决定是否放行
```

### 2.3 常见应用场景


| 应用场景 | **命令示例** | **实际含义** |
|---------|------------|-------------|
| 🏢 **管理员访问** | `iptables -A INPUT -s 192.168.1.10 -p tcp --dport 22 -j ACCEPT` | `只允许管理员电脑SSH登录` |
| 🚫 **恶意IP屏蔽** | `iptables -A INPUT -s 1.2.3.4 -j DROP` | `完全屏蔽某个攻击IP` |
| 🌐 **特定服务访问** | `iptables -A INPUT -s 10.0.0.5 -p tcp --dport 80 -j ACCEPT` | `只允许特定IP访问网站` |

---

## 3. 📥 目标IP地址过滤(-d参数)


### 3.1 -d参数基本概念


**🔸 基本语法**
```bash
iptables -A OUTPUT -d <IP地址> -j <动作>
```

**🔸 通俗解释**
`-d`是"destination"（目的地）的缩写，用来控制"这台服务器能向哪些IP地址发送数据"。

### 3.2 目标IP过滤实例


**🔸 控制出站流量**
```bash
# 禁止访问某个恶意网站
iptables -A OUTPUT -d 192.168.100.50 -j DROP

# 只允许访问公司邮件服务器
iptables -A OUTPUT -d 10.0.0.100 -p tcp --dport 25 -j ACCEPT

# 阻止访问外网某个IP段
iptables -A OUTPUT -d 203.0.113.0/24 -j REJECT
```

**🔸 实际应用理解**
```
企业网络管控实例：
🏢 公司政策：员工电脑不能访问娱乐网站
🔧 技术实现：用-d参数阻止访问娱乐网站IP
💡 现实效果：员工无法访问被屏蔽的网站

防火墙规则：
iptables -A OUTPUT -d 娱乐网站IP -j DROP
```

### 3.3 -s与-d的区别对比


| 参数 | **过滤方向** | **应用场景** | **通俗理解** |
|------|------------|-------------|-------------|
| **`-s`** | `入站流量控制` | `控制谁能访问我` | `门卫检查访客证件` |
| **`-d`** | `出站流量控制` | `控制我能访问谁` | `限制员工外出权限` |

---

## 4. 📊 IP地址段CIDR表示法


### 4.1 什么是CIDR


**🔸 CIDR概念解释**
CIDR（无类别域间路由）是一种表示IP地址范围的方法。就像邮政编码一样，用简洁的方式表示一整个地区。

**🔸 CIDR格式构成**
```
CIDR格式：IP地址/子网掩码位数

示例解析：
192.168.1.0/24
   ↓        ↓
 网络地址  掩码位数

通俗理解：
192.168.1.0/24 = 192.168.1.0 到 192.168.1.255
就像"北京市朝阳区"包含了该区域内所有地址
```

### 4.2 常用CIDR网段说明


**🔸 网段大小对照表**

| CIDR表示 | **包含IP数量** | **IP范围示例** | **实际用途** |
|---------|--------------|--------------|-------------|
| `/32` | `1个IP` | `192.168.1.100/32` | `指定单个主机` |
| `/24` | `256个IP` | `192.168.1.0/24` | `小型局域网` |
| `/16` | `65536个IP` | `192.168.0.0/16` | `大型企业网络` |
| `/8` | `16777216个IP` | `10.0.0.0/8` | `超大型网络` |

### 4.3 CIDR实用命令示例


**🔸 网段过滤实例**
```bash
# 允许整个局域网访问
iptables -A INPUT -s 192.168.1.0/24 -j ACCEPT

# 阻止某个危险网段
iptables -A INPUT -s 10.0.100.0/24 -j DROP

# 只允许公司网段访问SSH
iptables -A INPUT -s 172.16.0.0/16 -p tcp --dport 22 -j ACCEPT
```

**🔸 记忆技巧**
```
💡 数字越大，范围越小
/32 = 1个IP（最精确）
/24 = 256个IP（常用局域网）
/16 = 65536个IP（大公司）
/8 = 1600万个IP（超大网络）

🧠 记忆口诀：
"32单个，24局域，16公司，8超大"
```

---

## 5. 🎯 地址范围模块(-m iprange)


### 5.1 iprange模块基本概念


**🔸 什么是iprange模块**
当你需要指定一个不规则的IP地址范围时（不是标准的CIDR网段），就需要使用iprange模块。就像说"从北京路100号到北京路200号"这样的范围指定。

**🔸 基本语法格式**
```bash
iptables -A INPUT -m iprange --src-range IP开始-IP结束 -j <动作>
iptables -A INPUT -m iprange --dst-range IP开始-IP结束 -j <动作>
```

### 5.2 iprange实用示例


**🔸 源IP范围过滤**
```bash
# 允许192.168.1.50到192.168.1.80范围内的IP访问
iptables -A INPUT -m iprange --src-range 192.168.1.50-192.168.1.80 -j ACCEPT

# 阻止10.0.0.100到10.0.0.200范围的IP
iptables -A INPUT -m iprange --src-range 10.0.0.100-10.0.0.200 -j DROP
```

**🔸 目标IP范围过滤**
```bash
# 禁止访问某个IP段的服务器
iptables -A OUTPUT -m iprange --dst-range 203.0.113.10-203.0.113.50 -j REJECT
```

### 5.3 iprange vs CIDR选择指南


| 场景 | **推荐方法** | **原因** | **示例** |
|------|------------|---------|---------|
| **标准网段** | `CIDR` | `表示简洁，性能更好` | `192.168.1.0/24` |
| **不规则范围** | `iprange` | `灵活指定任意范围` | `192.168.1.50-192.168.1.80` |
| **单个IP** | `直接指定` | `最简单直接` | `192.168.1.100` |

**🔸 选择建议**
```
优先级顺序：
1️⃣ 能用CIDR就用CIDR（性能最好）
2️⃣ 不规则范围才用iprange
3️⃣ 单个IP直接写IP地址

⚡ 性能提示：CIDR > 直接IP > iprange
```

---

## 6. 🔄 取反操作符(!)使用


### 6.1 取反操作符基本概念


**🔸 什么是取反操作**
取反操作符`!`的作用是"除了...之外"，相当于逻辑上的"非"运算。就像说"除了张三，其他人都不能进入"。

**🔸 基本语法**
```bash
iptables -A INPUT -s ! IP地址 -j <动作>
iptables -A INPUT ! -s IP地址 -j <动作>  # 两种写法等效
```

### 6.2 取反操作实用示例


**🔸 反向过滤示例**
```bash
# 除了192.168.1.100，拒绝其他所有IP的SSH访问
iptables -A INPUT ! -s 192.168.1.100 -p tcp --dport 22 -j DROP

# 除了本地网段，禁止其他网段访问80端口
iptables -A INPUT ! -s 192.168.1.0/24 -p tcp --dport 80 -j REJECT

# 除了管理员IP，其他IP都不能访问管理端口
iptables -A INPUT ! -s 10.0.0.10 -p tcp --dport 8080 -j DROP
```

### 6.3 取反操作应用场景


**🔸 白名单策略实现**
```bash
# 场景：只允许可信IP访问，其他全部拒绝
# 第1步：允许可信IP
iptables -A INPUT -s 192.168.1.100 -p tcp --dport 22 -j ACCEPT

# 第2步：拒绝其他所有IP（使用取反）
iptables -A INPUT ! -s 192.168.1.100 -p tcp --dport 22 -j DROP
```

**🔸 取反与直接写法对比**

| 需求 | **取反写法** | **直接写法** | **推荐选择** |
|------|------------|-------------|-------------|
| `只允许1个IP` | `! -s 其他IP -j DROP` | `-s 允许IP -j ACCEPT` | `直接写法更清晰` |
| `除了几个IP都拒绝` | `! -s IP段 -j DROP` | `多条ACCEPT规则` | `取反写法更简洁` |

---

## 7. 🔗 多IP地址组合过滤


### 7.1 多IP地址指定方法


**🔸 逗号分隔语法**
```bash
# 基本格式
iptables -A INPUT -s IP1,IP2,IP3 -j <动作>
```

**🔸 实用示例**
```bash
# 允许多个管理员IP访问SSH
iptables -A INPUT -s 192.168.1.10,192.168.1.20,192.168.1.30 -p tcp --dport 22 -j ACCEPT

# 阻止多个恶意IP
iptables -A INPUT -s 1.2.3.4,5.6.7.8,9.10.11.12 -j DROP

# 允许多个办公室IP访问内部服务
iptables -A INPUT -s 10.0.1.100,10.0.2.100,10.0.3.100 -p tcp --dport 8080 -j ACCEPT
```

### 7.2 混合地址格式组合


**🔸 IP+网段+范围组合**
```bash
# 复杂组合示例：允许单个IP、网段、范围的混合访问
iptables -A INPUT -s 192.168.1.10,192.168.2.0/24 -j ACCEPT

# 注意：iprange不能直接与逗号语法混合，需要分开写
iptables -A INPUT -s 192.168.1.10 -j ACCEPT
iptables -A INPUT -m iprange --src-range 192.168.1.50-192.168.1.80 -j ACCEPT
```

### 7.3 多IP管理最佳实践


**🔸 管理建议**
```
📝 维护技巧：
1️⃣ 将相关IP写在同一条规则中（提高效率）
2️⃣ 添加注释说明每个IP的用途
3️⃣ 定期清理无效的IP地址
4️⃣ 按功能分组管理IP列表

💡 示例：
# 管理员访问组
iptables -A INPUT -s 192.168.1.10,192.168.1.20 -p tcp --dport 22 -j ACCEPT
# 开发人员访问组  
iptables -A INPUT -s 192.168.1.30,192.168.1.40 -p tcp --dport 3000 -j ACCEPT
```

---

## 8. 🏠 本地IP地址识别技巧


### 8.1 本地IP地址查看方法


**🔸 常用查看命令**
```bash
# 查看所有网络接口IP
ip addr show

# 查看简化的IP信息
hostname -I

# 查看特定网卡IP
ip addr show eth0

# 传统命令（在某些系统可用）
ifconfig
```

### 8.2 特殊IP地址理解


**🔸 本地回环地址**
```
127.0.0.1 = localhost = 本机回环地址

通俗理解：
这个地址永远指向自己，就像镜子一样
无论在哪台电脑上，127.0.0.1都是"我自己"

实际应用：
iptables -A INPUT -s 127.0.0.1 -j ACCEPT  # 允许本机访问
```

**🔸 任意地址表示**
```
0.0.0.0 = 任意IP地址 = 所有IP

应用示例：
iptables -A INPUT -s 0.0.0.0/0 -j DROP    # 拒绝所有IP
等同于：
iptables -A INPUT -j DROP                  # 省略-s参数
```

### 8.3 内网IP地址段识别


**🔸 私有IP地址范围**

| IP段 | **CIDR表示** | **用途说明** | **典型应用** |
|------|------------|-------------|-------------|
| **A类私网** | `10.0.0.0/8` | `大型企业网络` | `跨国公司内网` |
| **B类私网** | `172.16.0.0/12` | `中型企业网络` | `分支机构网络` |
| **C类私网** | `192.168.0.0/16` | `家庭/小型网络` | `家用路由器` |

**🔸 实用判断技巧**
```bash
# 快速判断是否为内网IP的规则规律
192.168.x.x  → 家庭/小办公室（最常见）
172.16.x.x 到 172.31.x.x  → 企业网络
10.x.x.x  → 大型企业网络

💡 记忆口诀：
"192家用，172企业，10大厂"
```

---

## 9. 🚀 实用案例与最佳实践


### 9.1 企业网络安全配置案例


**🔸 场景一：办公室网络访问控制**
```bash
# 需求：只允许公司内网访问服务器，外网全部拒绝

# 1. 允许公司内网访问
iptables -A INPUT -s 192.168.1.0/24 -j ACCEPT

# 2. 允许本机回环
iptables -A INPUT -s 127.0.0.1 -j ACCEPT

# 3. 拒绝其他所有外网访问
iptables -A INPUT -j DROP

# 实际效果：构建了一个内网防护墙
```

**🔸 场景二：Web服务器安全加固**
```bash
# 需求：网站对外开放，但管理端口只允许管理员访问

# 1. 允许所有IP访问网站（80端口）
iptables -A INPUT -p tcp --dport 80 -j ACCEPT

# 2. 只允许管理员IP访问SSH（22端口）
iptables -A INPUT -s 192.168.1.10 -p tcp --dport 22 -j ACCEPT

# 3. 拒绝其他IP的SSH访问
iptables -A INPUT -p tcp --dport 22 -j DROP
```

### 9.2 常见错误避免指南


**🔸 易错点警示**

> ⚠️ **规则顺序很重要**  
> iptables按顺序匹配规则，第一个匹配的规则生效  
> 错误示例：先写拒绝所有，再写允许特定IP（允许规则永远不会生效）

> ⚠️ **不要锁死自己**  
> 在远程配置iptables时，务必保留自己IP的SSH访问权限  
> 建议：先添加允许自己IP的规则，再添加限制规则

> ⚠️ **测试前先备份**  
> 重要生产环境配置前，先备份现有规则  
> 命令：`iptables-save > /etc/iptables.backup`

### 9.3 性能优化建议


**🔸 规则优化原则**
```
⚡ 性能提升技巧：

1️⃣ 常用规则放前面
   把最常匹配的规则放在规则链前面

2️⃣ 精确匹配优先
   优先使用：直接IP > CIDR > iprange

3️⃣ 合并相似规则
   多个相似规则可以用逗号合并

4️⃣ 避免过度复杂
   规则太复杂会影响性能

💡 优化示例：
# 优化前（低效）
iptables -A INPUT -s 192.168.1.10 -j ACCEPT
iptables -A INPUT -s 192.168.1.20 -j ACCEPT  
iptables -A INPUT -s 192.168.1.30 -j ACCEPT

# 优化后（高效）
iptables -A INPUT -s 192.168.1.10,192.168.1.20,192.168.1.30 -j ACCEPT
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心概念


**🔸 IP过滤核心要素**
```
📍 -s参数：控制"谁能访问我"（源IP过滤）
📍 -d参数：控制"我能访问谁"（目标IP过滤）  
📍 CIDR表示法：用/数字表示IP地址段
📍 iprange模块：指定不规则的IP范围
📍 取反操作!：实现"除了...之外"的逻辑
📍 多IP组合：用逗号分隔多个IP地址
```

### 10.2 关键理解要点


**🔹 数据包流向理解**
```
入站数据包流向：
外部IP ──发送──▶ 本机IP
     ↑              ↓
   用-s过滤       用-d过滤

出站数据包流向：  
本机IP ──发送──▶ 外部IP
     ↑              ↓  
   用-s过滤       用-d过滤

💡 记忆技巧：
"-s看来源，-d看目标"
```

**🔹 过滤策略选择**
```
安全策略类型：

🔒 白名单策略（推荐）：
   默认拒绝，明确允许
   iptables -P INPUT DROP
   iptables -A INPUT -s 信任IP -j ACCEPT

🔓 黑名单策略：
   默认允许，明确拒绝
   iptables -P INPUT ACCEPT  
   iptables -A INPUT -s 恶意IP -j DROP

建议：生产环境优先使用白名单策略
```

### 10.3 实际应用价值


**🔸 真实应用场景**
- **🏢 企业安全**：限制办公网络访问权限
- **🌐 网站防护**：阻止恶意IP攻击网站  
- **🔧 服务器管理**：只允许管理员远程维护
- **📱 应用发布**：控制API接口的访问范围
- **🏠 家庭网络**：保护家庭设备网络安全

**🔸 学习成长路径**
```
学习进阶路线：

🔰 入门阶段：掌握-s、-d基本用法
🔸 进阶阶段：熟练使用CIDR和iprange  
⭐ 高级阶段：组合多种过滤条件
🏆 专家阶段：设计企业级安全策略

每个阶段都要多练习实际案例！
```

### 10.4 速查参考表


| 需求 | **命令模板** | **说明** |
|------|------------|---------|
| **允许单个IP** | `iptables -A INPUT -s IP -j ACCEPT` | `最基础的白名单` |
| **拒绝单个IP** | `iptables -A INPUT -s IP -j DROP` | `最基础的黑名单` |
| **允许网段** | `iptables -A INPUT -s IP/掩码 -j ACCEPT` | `批量允许局域网` |
| **除了某IP都拒绝** | `iptables -A INPUT ! -s IP -j DROP` | `排除式过滤` |
| **允许多个IP** | `iptables -A INPUT -s IP1,IP2,IP3 -j ACCEPT` | `多IP组合` |
| **IP范围过滤** | `iptables -A INPUT -m iprange --src-range IP1-IP2 -j ACCEPT` | `灵活范围控制` |

**💡 学习建议**：
- 先理解概念，再背命令
- 多做实验，少纸上谈兵  
- 从简单案例开始，逐步复杂化
- 重视安全，测试时做好备份

**🧠 记忆口诀**：
```
"源用s，目标d，网段加斜杠
感叹号取反，逗号连多个  
安全第一记心中，规则顺序很重要"
```