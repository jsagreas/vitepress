---
title: 10ã€é«˜çº§ç”¨æˆ·ç®¡ç†å‘½ä»¤
---
## ğŸ“š ç›®å½•

1. [å¯†ç agingç­–ç•¥ç®¡ç†](#1-å¯†ç agingç­–ç•¥ç®¡ç†)
2. [ç”¨æˆ·è´¦æˆ·é”å®šç­–ç•¥](#2-ç”¨æˆ·è´¦æˆ·é”å®šç­–ç•¥)
3. [ç”¨æˆ·èµ„æºé™åˆ¶è®¾ç½®](#3-ç”¨æˆ·èµ„æºé™åˆ¶è®¾ç½®)
4. [ç”¨æˆ·ä¼šè¯ç®¡ç†ä¸æ§åˆ¶](#4-ç”¨æˆ·ä¼šè¯ç®¡ç†ä¸æ§åˆ¶)
5. [æ‰¹é‡ç”¨æˆ·æ“ä½œæœ€ä½³å®è·µ](#5-æ‰¹é‡ç”¨æˆ·æ“ä½œæœ€ä½³å®è·µ)
6. [ç”¨æˆ·ç®¡ç†å®‰å…¨åŠ å›ºæªæ–½](#6-ç”¨æˆ·ç®¡ç†å®‰å…¨åŠ å›ºæªæ–½)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å¯†ç agingç­–ç•¥ç®¡ç†


### 1.1 chageå‘½ä»¤åŸºç¡€


**ä»€ä¹ˆæ˜¯å¯†ç agingç­–ç•¥**

å¯†ç agingï¼ˆå¯†ç æ—¶æ•ˆï¼‰æ˜¯Linuxç³»ç»Ÿä¸­æ§åˆ¶å¯†ç ç”Ÿå‘½å‘¨æœŸçš„å®‰å…¨æœºåˆ¶ã€‚ç®€å•è¯´å°±æ˜¯è®©å¯†ç "è¿‡æœŸ"ï¼Œå¼ºåˆ¶ç”¨æˆ·å®šæœŸæ›´æ¢å¯†ç ï¼Œæé«˜ç³»ç»Ÿå®‰å…¨æ€§ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**  
> å°±åƒé“¶è¡Œå¡å¯†ç éœ€è¦å®šæœŸæ›´æ¢ä¸€æ ·ï¼ŒLinuxç³»ç»Ÿä¹Ÿå¯ä»¥è®¾ç½®å¯†ç çš„"æœ‰æ•ˆæœŸ"

**chageå‘½ä»¤çš„ä½œç”¨**

chageï¼ˆchange ageï¼‰å‘½ä»¤ä¸“é—¨ç”¨æ¥ç®¡ç†ç”¨æˆ·å¯†ç çš„æ—¶æ•ˆç­–ç•¥ï¼Œå¯ä»¥æ§åˆ¶ï¼š
- å¯†ç ä»€ä¹ˆæ—¶å€™è¿‡æœŸ
- ç”¨æˆ·å¤šä¹…å¿…é¡»æ¢ä¸€æ¬¡å¯†ç 
- å¯†ç åˆ°æœŸå‰å¤šä¹…å¼€å§‹æé†’
- è´¦æˆ·ä»€ä¹ˆæ—¶å€™è¢«é”å®š

### 1.2 å¯†ç agingæ ¸å¿ƒæ¦‚å¿µ


**å…³é”®æ—¶é—´æ¦‚å¿µå›¾è§£**

```
å¯†ç ç”Ÿå‘½å‘¨æœŸæ—¶é—´è½´ï¼š
åˆ›å»ºå¯†ç  â†’ æœ€å°ä½¿ç”¨æœŸ â†’ æ­£å¸¸ä½¿ç”¨æœŸ â†’ è­¦å‘ŠæœŸ â†’ è¿‡æœŸ â†’ é”å®š

|---------|===============|====è­¦å‘Š====|xxxè¿‡æœŸxxx|
0å¤©      7å¤©             90å¤©       97å¤©      100å¤©
       (æœ€å°æœŸ)         (æœ€å¤§æœŸ)    (è­¦å‘ŠæœŸ)   (é”å®šæœŸ)
```

**æ ¸å¿ƒå‚æ•°å«ä¹‰**

| å‚æ•° | è‹±æ–‡å«ä¹‰ | ä¸­æ–‡è§£é‡Š | å®é™…æ„ä¹‰ |
|------|----------|----------|----------|
| **æœ€å°å¯†ç å¹´é¾„** | Min Password Age | å¯†ç æœ€çŸ­ä½¿ç”¨æ—¶é—´ | é˜²æ­¢ç”¨æˆ·é¢‘ç¹æ”¹å›åŸå¯†ç  |
| **æœ€å¤§å¯†ç å¹´é¾„** | Max Password Age | å¯†ç æœ€é•¿ä½¿ç”¨æ—¶é—´ | å¼ºåˆ¶ç”¨æˆ·å®šæœŸæ›´æ¢å¯†ç  |
| **è­¦å‘ŠæœŸ** | Warning Period | åˆ°æœŸå‰è­¦å‘Šå¤©æ•° | æå‰æé†’ç”¨æˆ·å‡†å¤‡æ¢å¯†ç  |
| **éæ´»è·ƒæœŸ** | Inactive Period | è¿‡æœŸåå®½é™å¤©æ•° | è¿‡æœŸåè¿˜èƒ½ç™»å½•çš„å¤©æ•° |
| **åˆ°æœŸæ—¥** | Expiration Date | è´¦æˆ·å½»åº•åˆ°æœŸæ—¥ | è´¦æˆ·è¢«æ°¸ä¹…ç¦ç”¨çš„æ—¥æœŸ |

### 1.3 chageå‘½ä»¤è¯¦ç»†ç”¨æ³•


**æŸ¥çœ‹ç”¨æˆ·å¯†ç ä¿¡æ¯**

```bash
# æŸ¥çœ‹ç”¨æˆ·johnçš„å¯†ç agingä¿¡æ¯
chage -l john

# è¾“å‡ºè§£é‡Šï¼š
Last password change                    : Jan 15, 2024
Password expires                        : Apr 15, 2024
Password inactive                       : Apr 22, 2024
Account expires                         : never
Minimum number of days between password change : 7
Maximum number of days between password change : 90
Number of days of warning before password expires : 7
```

**è®¾ç½®å¯†ç ç­–ç•¥å‚æ•°**

```bash
# è®¾ç½®å¯†ç æœ€å¤§ä½¿ç”¨æœŸä¸º90å¤©
chage -M 90 john

# è®¾ç½®å¯†ç æœ€å°ä½¿ç”¨æœŸä¸º7å¤©ï¼ˆé˜²æ­¢ç«‹å³æ”¹å›åŸå¯†ç ï¼‰
chage -m 7 john

# è®¾ç½®åˆ°æœŸå‰7å¤©å¼€å§‹è­¦å‘Š
chage -W 7 john

# è®¾ç½®å¯†ç è¿‡æœŸå7å¤©å†…è¿˜èƒ½ç™»å½•
chage -I 7 john

# è®¾ç½®è´¦æˆ·åˆ°æœŸæ—¥æœŸ
chage -E 2024-12-31 john

# å¼ºåˆ¶ç”¨æˆ·ä¸‹æ¬¡ç™»å½•æ—¶å¿…é¡»æ›´æ”¹å¯†ç 
chage -d 0 john
```

### 1.4 å¯†ç è¿‡æœŸç­–ç•¥å®æˆ˜é…ç½®


**åœºæ™¯ä¸€ï¼šæ–°å‘˜å·¥è´¦æˆ·é…ç½®**

```bash
# æ–°å‘˜å·¥johnå…¥èŒï¼Œè®¾ç½®ä¸¥æ ¼çš„å¯†ç ç­–ç•¥
chage -m 7 -M 90 -W 7 -I 3 john

# å«ä¹‰è§£é‡Šï¼š
# -m 7: å¯†ç æ”¹å®Œå7å¤©å†…ä¸èƒ½å†æ”¹
# -M 90: å¯†ç 90å¤©åå¿…é¡»æ›´æ¢
# -W 7: åˆ°æœŸå‰7å¤©å¼€å§‹æé†’
# -I 3: è¿‡æœŸå3å¤©å†…å¿…é¡»æ”¹å¯†ç ï¼Œå¦åˆ™é”å®š
```

**åœºæ™¯äºŒï¼šä¸´æ—¶è´¦æˆ·ç®¡ç†**

```bash
# åˆ›å»ºæœ‰æ—¶é™çš„ä¸´æ—¶è´¦æˆ·
useradd temp_user
chage -E 2024-03-01 temp_user  # è´¦æˆ·3æœˆ1æ—¥è‡ªåŠ¨åˆ°æœŸ
chage -M 30 temp_user          # å¯†ç 30å¤©è¿‡æœŸ
```

> âš ï¸ **é‡è¦æé†’**  
> è®¾ç½®å¯†ç ç­–ç•¥åï¼Œç”¨æˆ·ä¼šåœ¨ç™»å½•æ—¶æ”¶åˆ°ç›¸åº”æç¤ºï¼Œç®¡ç†å‘˜éœ€è¦æå‰é€šçŸ¥ç”¨æˆ·

**æ‰¹é‡è®¾ç½®å¯†ç ç­–ç•¥**

```bash
#!/bin/bash
# æ‰¹é‡ä¸ºå¤šä¸ªç”¨æˆ·è®¾ç½®ç›¸åŒçš„å¯†ç ç­–ç•¥
users=("alice" "bob" "charlie")

for user in "${users[@]}"; do
    chage -m 7 -M 90 -W 7 -I 7 "$user"
    echo "å·²ä¸ºç”¨æˆ· $user è®¾ç½®å¯†ç ç­–ç•¥"
done
```

---

## 2. ğŸ”’ ç”¨æˆ·è´¦æˆ·é”å®šç­–ç•¥


### 2.1 è´¦æˆ·é”å®šæœºåˆ¶åŸç†


**ä»€ä¹ˆæ˜¯è´¦æˆ·é”å®š**

è´¦æˆ·é”å®šæ˜¯å½“ç”¨æˆ·è¿åå®‰å…¨ç­–ç•¥ï¼ˆå¦‚å¤šæ¬¡è¾“å…¥é”™è¯¯å¯†ç ï¼‰æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨ç¦æ­¢è¯¥ç”¨æˆ·ç™»å½•çš„ä¿æŠ¤æœºåˆ¶ã€‚

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒATMæœºè¿ç»­3æ¬¡è¾“é”™å¯†ç ä¼šåå¡ä¸€æ ·ï¼ŒLinuxç³»ç»Ÿä¹Ÿä¼šåœ¨å¤šæ¬¡ç™»å½•å¤±è´¥åé”å®šè´¦æˆ·

**é”å®šè§¦å‘æ¡ä»¶**

```
å¸¸è§é”å®šè§¦å‘åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯†ç è¿ç»­é”™è¯¯   â”‚ â†’   â”‚  ç™»å½•æ¬¡æ•°è¶…é™   â”‚ â†’   â”‚   è´¦æˆ·è¢«é”å®š    â”‚
â”‚   (3-5æ¬¡)      â”‚     â”‚   (æ”»å‡»æ£€æµ‹)   â”‚     â”‚  (ä¸´æ—¶/æ°¸ä¹…)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 faillockå‘½ä»¤è¯¦è§£


**faillockåŸºæœ¬æ¦‚å¿µ**

faillockæ˜¯ç°ä»£Linuxç³»ç»Ÿä¸­å¤„ç†ç™»å½•å¤±è´¥é”å®šçš„å·¥å…·ï¼Œå–ä»£äº†è€çš„pam_tally2ã€‚

**æŸ¥çœ‹é”å®šçŠ¶æ€**

```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•å¤±è´¥è®°å½•
faillock

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„å¤±è´¥è®°å½•
faillock --user john

# è¾“å‡ºç¤ºä¾‹ï¼š
john:
When                Type  Source                           Valid
2024-01-15 14:30:25 TTY   /dev/pts/1                           V
2024-01-15 14:30:45 TTY   /dev/pts/1                           V
2024-01-15 14:31:02 TTY   /dev/pts/1                           V
```

**è§£é”è¢«é”å®šçš„è´¦æˆ·**

```bash
# é‡ç½®ç‰¹å®šç”¨æˆ·çš„å¤±è´¥è®¡æ•°
faillock --user john --reset

# é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„å¤±è´¥è®°æ•°
faillock --reset
```

### 2.3 é…ç½®è‡ªåŠ¨é”å®šç­–ç•¥


**PAMé…ç½®æ–‡ä»¶ä½ç½®**

ä¸»è¦é…ç½®æ–‡ä»¶ï¼š`/etc/security/faillock.conf`

**æ ¸å¿ƒé…ç½®å‚æ•°**

```bash
# ç¼–è¾‘faillocké…ç½®æ–‡ä»¶
vim /etc/security/faillock.conf

# é‡è¦é…ç½®é¡¹ï¼š
deny = 5           # å¤±è´¥5æ¬¡åé”å®š
unlock_time = 600  # é”å®š10åˆ†é’Ÿ(600ç§’)åè‡ªåŠ¨è§£é”
fail_interval = 900 # 900ç§’å†…çš„å¤±è´¥å°è¯•æ‰è®¡æ•°
root_unlock_time = 60 # rootç”¨æˆ·é”å®š1åˆ†é’Ÿ
```

**é…ç½®å‚æ•°è¯¦è§£è¡¨**

| å‚æ•°å | é»˜è®¤å€¼ | å«ä¹‰ | æ¨èè®¾ç½® |
|--------|--------|------|----------|
| `deny` | 3 | é”å®šå‰çš„æœ€å¤§å¤±è´¥æ¬¡æ•° | 3-5æ¬¡ |
| `unlock_time` | 600 | è‡ªåŠ¨è§£é”æ—¶é—´(ç§’) | 300-1800ç§’ |
| `fail_interval` | 900 | å¤±è´¥è®¡æ•°æœ‰æ•ˆæœŸ(ç§’) | 300-900ç§’ |
| `root_unlock_time` | æœªè®¾ç½® | rootç”¨æˆ·è§£é”æ—¶é—´ | 60-300ç§’ |

> ğŸ¯ **é…ç½®å»ºè®®**  
> æ™®é€šç¯å¢ƒï¼š3æ¬¡å¤±è´¥é”å®š10åˆ†é’Ÿ  
> é«˜å®‰å…¨ç¯å¢ƒï¼š5æ¬¡å¤±è´¥é”å®š30åˆ†é’Ÿ  
> å¼€å‘ç¯å¢ƒï¼š5æ¬¡å¤±è´¥é”å®š5åˆ†é’Ÿ

### 2.4 æ‰‹åŠ¨é”å®šä¸è§£é”è´¦æˆ·


**ä½¿ç”¨usermodé”å®šè´¦æˆ·**

```bash
# é”å®šç”¨æˆ·è´¦æˆ·ï¼ˆåœ¨å¯†ç å‰åŠ !ï¼‰
usermod -L john

# è§£é”ç”¨æˆ·è´¦æˆ·
usermod -U john

# æ£€æŸ¥è´¦æˆ·é”å®šçŠ¶æ€
passwd -S john
# è¾“å‡ºï¼šjohn PS 2024-01-15 7 90 7 -1 (Password set, SHA512 crypt)
# å¦‚æœè¢«é”å®šä¼šæ˜¾ç¤ºï¼šjohn LK ...
```

**ä½¿ç”¨passwdå‘½ä»¤é”å®š**

```bash
# é”å®šè´¦æˆ·
passwd -l john

# è§£é”è´¦æˆ·  
passwd -u john

# å¼ºåˆ¶ç”¨æˆ·ä¸‹æ¬¡ç™»å½•æ—¶æ›´æ”¹å¯†ç 
passwd -e john
```

---

## 3. ğŸ“Š ç”¨æˆ·èµ„æºé™åˆ¶è®¾ç½®


### 3.1 ä»€ä¹ˆæ˜¯èµ„æºé™åˆ¶


**èµ„æºé™åˆ¶çš„ä½œç”¨**

èµ„æºé™åˆ¶ï¼ˆulimitï¼‰æ˜¯Linuxç³»ç»Ÿæ§åˆ¶ç”¨æˆ·æˆ–è¿›ç¨‹èƒ½ä½¿ç”¨å¤šå°‘ç³»ç»Ÿèµ„æºçš„æœºåˆ¶ã€‚é˜²æ­¢å•ä¸ªç”¨æˆ·æˆ–ç¨‹åºæ¶ˆè€—è¿‡å¤šèµ„æºå½±å“æ•´ä¸ªç³»ç»Ÿã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**  
> å°±åƒå®¿èˆé™ç”µä¸€æ ·ï¼Œç³»ç»Ÿç»™æ¯ä¸ªç”¨æˆ·è®¾ç½®"ç”¨ç”µä¸Šé™"ï¼Œé˜²æ­¢æœ‰äººç”¨ç”µè¿‡å¤šå½±å“å…¶ä»–äºº

**å¸¸è§èµ„æºç±»å‹**

```
ç³»ç»Ÿèµ„æºåˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CPUæ—¶é—´ â”‚  å†…å­˜   â”‚ æ–‡ä»¶æ•°  â”‚ è¿›ç¨‹æ•°  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â±ï¸    â”‚   ğŸ’¾    â”‚   ğŸ“    â”‚   ğŸ”„    â”‚
â”‚ é˜²æ­¢CPU â”‚ é˜²æ­¢å†…å­˜ â”‚ é˜²æ­¢æ–‡ä»¶ â”‚ é˜²æ­¢è¿›ç¨‹ â”‚
â”‚   å ç”¨   â”‚   æ³„æ¼   â”‚   æ³›æ»¥   â”‚   çˆ†ç‚¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ulimitå‘½ä»¤ä½¿ç”¨


**æŸ¥çœ‹å½“å‰é™åˆ¶**

```bash
# æŸ¥çœ‹æ‰€æœ‰èµ„æºé™åˆ¶
ulimit -a

# å¸¸è§è¾“å‡ºï¼š
core file size          (blocks, -c) 0           # æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶å¤§å°
data seg size           (kbytes, -d) unlimited   # æ•°æ®æ®µå¤§å°
scheduling priority             (-e) 0           # è°ƒåº¦ä¼˜å…ˆçº§
file size               (blocks, -f) unlimited   # å•ä¸ªæ–‡ä»¶å¤§å°
pending signals                 (-i) 15663       # å¾…å¤„ç†ä¿¡å·æ•°é‡
max locked memory       (kbytes, -l) 16384       # æœ€å¤§é”å®šå†…å­˜
max memory size         (kbytes, -m) unlimited   # æœ€å¤§å†…å­˜ä½¿ç”¨
open files                      (-n) 1024        # æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°
pipe size            (512 bytes, -p) 8           # ç®¡é“å¤§å°
POSIX message queues     (bytes, -q) 819200      # æ¶ˆæ¯é˜Ÿåˆ—å¤§å°
real-time priority              (-r) 0           # å®æ—¶ä¼˜å…ˆçº§
stack size              (kbytes, -s) 8192        # æ ˆå¤§å°
cpu time               (seconds, -t) unlimited   # CPUæ—¶é—´
max user processes              (-u) 15663       # æœ€å¤§è¿›ç¨‹æ•°
virtual memory          (kbytes, -v) unlimited   # è™šæ‹Ÿå†…å­˜
file locks                      (-x) unlimited   # æ–‡ä»¶é”æ•°é‡
```

**è®¾ç½®ä¸´æ—¶é™åˆ¶**

```bash
# é™åˆ¶æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°ä¸º2048
ulimit -n 2048

# é™åˆ¶å•ä¸ªæ–‡ä»¶æœ€å¤§1GB
ulimit -f 1048576  # ä»¥KBä¸ºå•ä½

# é™åˆ¶æœ€å¤§è¿›ç¨‹æ•°ä¸º100
ulimit -u 100

# é™åˆ¶CPUæ—¶é—´ä¸º60ç§’
ulimit -t 60
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> ulimitè®¾ç½®çš„é™åˆ¶åªå¯¹å½“å‰shellä¼šè¯æœ‰æ•ˆï¼Œé‡æ–°ç™»å½•åä¼šé‡ç½®

### 3.3 æ°¸ä¹…èµ„æºé™åˆ¶é…ç½®


**limits.confé…ç½®æ–‡ä»¶**

æ°¸ä¹…çš„èµ„æºé™åˆ¶é…ç½®åœ¨ `/etc/security/limits.conf` æ–‡ä»¶ä¸­ï¼š

```bash
# ç¼–è¾‘limitsé…ç½®æ–‡ä»¶
vim /etc/security/limits.conf

# é…ç½®æ ¼å¼ï¼š<domain> <type> <item> <value>
# domain: ç”¨æˆ·åã€ç»„åæˆ–*ï¼ˆæ‰€æœ‰ç”¨æˆ·ï¼‰
# type: softï¼ˆè½¯é™åˆ¶ï¼‰æˆ–hardï¼ˆç¡¬é™åˆ¶ï¼‰  
# item: èµ„æºç±»å‹
# value: é™åˆ¶å€¼

# ç¤ºä¾‹é…ç½®ï¼š
john     soft    nproc     100        # johnç”¨æˆ·æœ€å¤š100ä¸ªè¿›ç¨‹
john     hard    nproc     150        # johnç”¨æˆ·ç»å¯¹ä¸è¶…è¿‡150ä¸ªè¿›ç¨‹
@dev     soft    nofile    2048       # devç»„ç”¨æˆ·æœ€å¤šæ‰“å¼€2048ä¸ªæ–‡ä»¶
@dev     hard    nofile    4096       # devç»„ç”¨æˆ·ç»å¯¹ä¸è¶…è¿‡4096ä¸ªæ–‡ä»¶
*        soft    core      0          # æ‰€æœ‰ç”¨æˆ·ä¸ç”Ÿæˆæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶
*        hard    rss       10000      # æ‰€æœ‰ç”¨æˆ·æœ€å¤§ç‰©ç†å†…å­˜10MB
```

**è½¯é™åˆ¶ä¸ç¡¬é™åˆ¶çš„åŒºåˆ«**

| é™åˆ¶ç±»å‹ | å«ä¹‰ | ç‰¹ç‚¹ | ç”¨é€” |
|----------|------|------|------|
| **softè½¯é™åˆ¶** | å¯ä»¥ä¸´æ—¶è¶…è¶Šçš„è­¦å‘Šçº¿ | ç”¨æˆ·å¯ä»¥è‡ªå·±è°ƒæ•´ | æ—¥å¸¸ä½¿ç”¨çš„æ¨èå€¼ |
| **hardç¡¬é™åˆ¶** | ç»å¯¹ä¸èƒ½è¶…è¶Šçš„çº¢çº¿ | åªæœ‰rootèƒ½ä¿®æ”¹ | ç³»ç»Ÿå®‰å…¨çš„åº•çº¿ |

> ğŸ’¡ **å½¢è±¡æ¯”å–»**  
> è½¯é™åˆ¶åƒ"å»ºè®®é€Ÿåº¦"ï¼Œç¡¬é™åˆ¶åƒ"é™é€Ÿæ‘„åƒå¤´"  
> å¯ä»¥è¶…è¿‡å»ºè®®é€Ÿåº¦ï¼Œä½†ç»ä¸èƒ½è¶…è¿‡é™é€Ÿä¸Šé™

### 3.4 å®æˆ˜èµ„æºé™åˆ¶é…ç½®


**WebæœåŠ¡å™¨ç”¨æˆ·é™åˆ¶**

```bash
# ä¸ºwebç”¨æˆ·ç»„è®¾ç½®é€‚åˆçš„é™åˆ¶
echo "# WebæœåŠ¡å™¨èµ„æºé™åˆ¶" >> /etc/security/limits.conf
echo "@web     soft    nproc     200" >> /etc/security/limits.conf
echo "@web     hard    nproc     300" >> /etc/security/limits.conf
echo "@web     soft    nofile    4096" >> /etc/security/limits.conf
echo "@web     hard    nofile    8192" >> /etc/security/limits.conf
```

**æ•°æ®åº“ç”¨æˆ·èµ„æºé™åˆ¶**

```bash
# MySQLç”¨æˆ·éœ€è¦æ›´å¤šçš„æ–‡ä»¶å¥æŸ„å’Œå†…å­˜
echo "mysql    soft    nofile    65536" >> /etc/security/limits.conf
echo "mysql    hard    nofile    65536" >> /etc/security/limits.conf
echo "mysql    soft    memlock   unlimited" >> /etc/security/limits.conf
echo "mysql    hard    memlock   unlimited" >> /etc/security/limits.conf
```

---

## 4. ğŸ‘¥ ç”¨æˆ·ä¼šè¯ç®¡ç†ä¸æ§åˆ¶


### 4.1 ç”¨æˆ·ä¼šè¯åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç”¨æˆ·ä¼šè¯**

ç”¨æˆ·ä¼šè¯æ˜¯æŒ‡ä»ç”¨æˆ·ç™»å½•åˆ°é€€å‡ºç™»å½•çš„æ•´ä¸ªè¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ‰€æœ‰åœ¨æ­¤æœŸé—´è¿è¡Œçš„ç¨‹åºå’Œæ“ä½œã€‚

```
ç”¨æˆ·ä¼šè¯ç”Ÿå‘½å‘¨æœŸï¼š
ç™»å½• â†’ ä¼šè¯å»ºç«‹ â†’ æ‰§è¡Œå‘½ä»¤ â†’ è¿è¡Œç¨‹åº â†’ é€€å‡º â†’ ä¼šè¯ç»“æŸ
 â†“       â†“         â†“        â†“        â†“       â†“
SSHè¿æ¥  åˆ†é…TTY   æ‰§è¡Œbash  å¯åŠ¨ç¨‹åº  logout  æ¸…ç†èµ„æº
```

### 4.2 æŸ¥çœ‹ç”¨æˆ·ä¼šè¯ä¿¡æ¯


**whoå‘½ä»¤ - æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·**

```bash
# æŸ¥çœ‹å½“å‰æ‰€æœ‰ç™»å½•ç”¨æˆ·
who

# è¾“å‡ºç¤ºä¾‹ï¼š
john     pts/0        2024-01-15 14:30 (192.168.1.100)
alice    pts/1        2024-01-15 15:15 (192.168.1.101)
root     tty1         2024-01-15 09:00

# è¯¦ç»†ä¿¡æ¯æ˜¾ç¤º
who -u
john     pts/0        2024-01-15 14:30   .          2345 (192.168.1.100)
#ç”¨æˆ·å  ç»ˆç«¯ç±»å‹      ç™»å½•æ—¶é—´         ç©ºé—²æ—¶é—´    è¿›ç¨‹ID   æ¥æºIP
```

**wå‘½ä»¤ - è¯¦ç»†ä¼šè¯ä¿¡æ¯**

```bash
# æ˜¾ç¤ºè¯¦ç»†çš„ç”¨æˆ·æ´»åŠ¨ä¿¡æ¯
w

# è¾“å‡ºè§£é‡Šï¼š
 15:30:25 up  6:30,  3 users,  load average: 0.15, 0.25, 0.30
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
john     pts/0    192.168.1.100    14:30    0.00s  0.12s  0.01s vim file.txt
alice    pts/1    192.168.1.101    15:15    5:00   0.03s  0.03s -bash
root     tty1     -                09:00   30:00   1.25s  0.05s top
```

**lastå‘½ä»¤ - ç™»å½•å†å²è®°å½•**

```bash
# æŸ¥çœ‹ç”¨æˆ·ç™»å½•å†å²
last

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„ç™»å½•å†å²
last john

# æŸ¥çœ‹æœ€è¿‘10æ¬¡ç™»å½•
last -n 10

# æŸ¥çœ‹ç™»å½•å¤±è´¥è®°å½•
lastb
```

### 4.3 ç»ˆæ­¢ç”¨æˆ·ä¼šè¯


**è¸¢å‡ºåœ¨çº¿ç”¨æˆ·**

```bash
# ä½¿ç”¨pkillç»ˆæ­¢ç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹
pkill -KILL -u john

# æ›´æ¸©å’Œçš„æ–¹å¼ï¼Œç»™ç”¨æˆ·å‘é€ç»ˆæ­¢ä¿¡å·
pkill -TERM -u john

# ç»ˆæ­¢ç‰¹å®šç»ˆç«¯çš„ä¼šè¯
pkill -9 -t pts/0
```

**ä½¿ç”¨skillå‘½ä»¤ï¼ˆå¦‚æœå¯ç”¨ï¼‰**

```bash
# ç»ˆæ­¢ç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹
skill -KILL john

# å‘ç”¨æˆ·å‘é€æ¶ˆæ¯åç»ˆæ­¢
wall "ç³»ç»Ÿå°†åœ¨5åˆ†é’Ÿåé‡å¯ï¼Œè¯·ä¿å­˜å·¥ä½œ"
sleep 300
skill -KILL john
```

### 4.4 é™åˆ¶ç”¨æˆ·ç™»å½•


**é™åˆ¶ç™»å½•æ—¶é—´**

ç¼–è¾‘ `/etc/security/time.conf` æ–‡ä»¶ï¼š

```bash
# é™åˆ¶ç”¨æˆ·ç™»å½•æ—¶é—´
echo "login;*;john;MoTuWeThFr0800-1800" >> /etc/security/time.conf
# å«ä¹‰ï¼šjohnç”¨æˆ·åªèƒ½åœ¨å·¥ä½œæ—¥8:00-18:00ç™»å½•

# æ—¶é—´æ ¼å¼è¯´æ˜ï¼š
# Mo Tu We Th Fr Sa Su - æ˜ŸæœŸ
# 0800-1800 - æ—¶é—´èŒƒå›´ï¼ˆ24å°æ—¶åˆ¶ï¼‰
```

**é™åˆ¶å¹¶å‘ç™»å½•æ•°é‡**

ç¼–è¾‘ `/etc/security/limits.conf`ï¼š

```bash
# é™åˆ¶ç”¨æˆ·æœ€å¤§ç™»å½•ä¼šè¯æ•°
echo "john     hard    maxlogins     2" >> /etc/security/limits.conf
# johnç”¨æˆ·æœ€å¤šåŒæ—¶ç™»å½•2ä¸ªä¼šè¯
```

### 4.5 ä¼šè¯è¶…æ—¶è®¾ç½®


**è®¾ç½®shellè¶…æ—¶**

```bash
# åœ¨ /etc/profile ä¸­è®¾ç½®å…¨å±€è¶…æ—¶
echo "export TMOUT=1800" >> /etc/profile
# 30åˆ†é’Ÿ(1800ç§’)æ— æ´»åŠ¨è‡ªåŠ¨é€€å‡º

# ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®è¶…æ—¶
echo "export TMOUT=3600" >> /home/john/.bashrc
# johnç”¨æˆ·1å°æ—¶æ— æ´»åŠ¨è‡ªåŠ¨é€€å‡º
```

**SSHè¿æ¥è¶…æ—¶è®¾ç½®**

ç¼–è¾‘ `/etc/ssh/sshd_config`ï¼š

```bash
# SSHå®¢æˆ·ç«¯æ´»è·ƒæ£€æµ‹
ClientAliveInterval 300     # æ¯300ç§’æ£€æŸ¥ä¸€æ¬¡å®¢æˆ·ç«¯
ClientAliveCountMax 3       # æœ€å¤šæ£€æŸ¥3æ¬¡æ— å“åº”å°±æ–­å¼€

# ç™»å½•è¶…æ—¶
LoginGraceTime 60          # 60ç§’å†…å¿…é¡»å®Œæˆç™»å½•è®¤è¯
```

---

## 5. ğŸ”„ æ‰¹é‡ç”¨æˆ·æ“ä½œæœ€ä½³å®è·µ


### 5.1 æ‰¹é‡åˆ›å»ºç”¨æˆ·


**ä½¿ç”¨è„šæœ¬æ‰¹é‡åˆ›å»º**

```bash
#!/bin/bash
# æ‰¹é‡åˆ›å»ºç”¨æˆ·è„šæœ¬

# ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶æ ¼å¼ï¼šç”¨æˆ·å:å…¨å:éƒ¨é—¨
# ç¤ºä¾‹ï¼šjohn:John Smith:IT
user_file="/tmp/users.txt"

# æ£€æŸ¥ç”¨æˆ·æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "$user_file" ]; then
    echo "ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶ä¸å­˜åœ¨ï¼š$user_file"
    exit 1
fi

# é€è¡Œè¯»å–ç”¨æˆ·ä¿¡æ¯å¹¶åˆ›å»ºç”¨æˆ·
while IFS=':' read -r username fullname department; do
    # è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Šè¡Œ
    [[ -z "$username" || "$username" =~ ^# ]] && continue
    
    # åˆ›å»ºç”¨æˆ·
    if useradd -c "$fullname - $department" -m -s /bin/bash "$username"; then
        echo "âœ“ æˆåŠŸåˆ›å»ºç”¨æˆ·: $username"
        
        # è®¾ç½®åˆå§‹å¯†ç ï¼ˆç”¨æˆ·å+123ï¼‰
        echo "$username:${username}123" | chpasswd
        
        # å¼ºåˆ¶é¦–æ¬¡ç™»å½•æ›´æ”¹å¯†ç 
        chage -d 0 "$username"
        
        echo "  - åˆå§‹å¯†ç : ${username}123"
        echo "  - é¦–æ¬¡ç™»å½•éœ€æ›´æ”¹å¯†ç "
    else
        echo "âœ— åˆ›å»ºç”¨æˆ·å¤±è´¥: $username"
    fi
done < "$user_file"
```

**newuserså‘½ä»¤æ‰¹é‡åˆ›å»º**

```bash
# åˆ›å»ºç”¨æˆ·ä¿¡æ¯æ–‡ä»¶ /tmp/newusers.txt
# æ ¼å¼ï¼šusername:password:uid:gid:comment:home:shell
cat > /tmp/newusers.txt << EOF
alice:temp123:2001:2001:Alice Johnson:/home/alice:/bin/bash
bob:temp456:2002:2002:Bob Wilson:/home/bob:/bin/bash
charlie:temp789:2003:2003:Charlie Brown:/home/charlie:/bin/bash
EOF

# æ‰¹é‡åˆ›å»ºç”¨æˆ·
newusers /tmp/newusers.txt

# æ‰¹é‡å¼ºåˆ¶æ›´æ”¹å¯†ç 
for user in alice bob charlie; do
    chage -d 0 "$user"
done
```

### 5.2 æ‰¹é‡ä¿®æ”¹ç”¨æˆ·å±æ€§


**æ‰¹é‡ä¿®æ”¹ç”¨æˆ·ç»„**

```bash
#!/bin/bash
# å°†æŒ‡å®šç”¨æˆ·åŠ å…¥ç‰¹å®šç»„

group_name="developers"
users=("alice" "bob" "charlie")

# ç¡®ä¿ç»„å­˜åœ¨
groupadd "$group_name" 2>/dev/null

# æ‰¹é‡æ·»åŠ ç”¨æˆ·åˆ°ç»„
for user in "${users[@]}"; do
    if usermod -a -G "$group_name" "$user"; then
        echo "âœ“ $user å·²æ·»åŠ åˆ° $group_name ç»„"
    else
        echo "âœ— æ·»åŠ  $user åˆ°ç»„å¤±è´¥"
    fi
done
```

**æ‰¹é‡è®¾ç½®å¯†ç ç­–ç•¥**

```bash
#!/bin/bash
# æ‰¹é‡è®¾ç½®å¯†ç agingç­–ç•¥

users=("alice" "bob" "charlie")

for user in "${users[@]}"; do
    # è®¾ç½®å¯†ç ç­–ç•¥ï¼š7å¤©æœ€å°é—´éš”ï¼Œ90å¤©è¿‡æœŸï¼Œ7å¤©è­¦å‘Š
    chage -m 7 -M 90 -W 7 "$user"
    echo "âœ“ $user å¯†ç ç­–ç•¥å·²è®¾ç½®"
done
```

### 5.3 æ‰¹é‡åˆ é™¤ç”¨æˆ·


**å®‰å…¨æ‰¹é‡åˆ é™¤è„šæœ¬**

```bash
#!/bin/bash
# å®‰å…¨æ‰¹é‡åˆ é™¤ç”¨æˆ·

# è¦åˆ é™¤çš„ç”¨æˆ·åˆ—è¡¨
users_to_delete=("temp1" "temp2" "temp3")

# å¤‡ä»½ç›®å½•
backup_dir="/backup/deleted_users"
mkdir -p "$backup_dir"

for user in "${users_to_delete[@]}"; do
    # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    if ! id "$user" &>/dev/null; then
        echo "âš ï¸  ç”¨æˆ· $user ä¸å­˜åœ¨ï¼Œè·³è¿‡"
        continue
    fi
    
    echo "å¤„ç†ç”¨æˆ·: $user"
    
    # 1. é”å®šç”¨æˆ·è´¦æˆ·
    usermod -L "$user"
    echo "  âœ“ è´¦æˆ·å·²é”å®š"
    
    # 2. ç»ˆæ­¢ç”¨æˆ·è¿›ç¨‹
    pkill -TERM -u "$user"
    sleep 5
    pkill -KILL -u "$user"
    echo "  âœ“ è¿›ç¨‹å·²ç»ˆæ­¢"
    
    # 3. å¤‡ä»½ç”¨æˆ·å®¶ç›®å½•
    if [ -d "/home/$user" ]; then
        tar -czf "$backup_dir/${user}_home_$(date +%Y%m%d).tar.gz" -C /home "$user"
        echo "  âœ“ å®¶ç›®å½•å·²å¤‡ä»½åˆ° $backup_dir"
    fi
    
    # 4. åˆ é™¤ç”¨æˆ·å’Œå®¶ç›®å½•
    userdel -r "$user"
    echo "  âœ“ ç”¨æˆ·å·²åˆ é™¤"
    
    echo "åˆ é™¤ç”¨æˆ· $user å®Œæˆ"
    echo "---"
done
```

### 5.4 æ‰¹é‡ç”¨æˆ·ä¿¡æ¯ç»Ÿè®¡


**ç”¨æˆ·ç»Ÿè®¡è„šæœ¬**

```bash
#!/bin/bash
# ç”¨æˆ·è´¦æˆ·ç»Ÿè®¡æŠ¥å‘Š

echo "=== Linuxç”¨æˆ·è´¦æˆ·ç»Ÿè®¡æŠ¥å‘Š ==="
echo "ç”Ÿæˆæ—¶é—´ï¼š$(date)"
echo

# 1. åŸºæœ¬ç”¨æˆ·ç»Ÿè®¡
total_users=$(awk -F: '$3 >= 1000 {count++} END {print count+0}' /etc/passwd)
system_users=$(awk -F: '$3 < 1000 {count++} END {print count+0}' /etc/passwd)

echo "ğŸ“Š ç”¨æˆ·æ•°é‡ç»Ÿè®¡ï¼š"
echo "  æ™®é€šç”¨æˆ·ï¼š$total_users"
echo "  ç³»ç»Ÿç”¨æˆ·ï¼š$system_users"
echo

# 2. ç”¨æˆ·ç™»å½•çŠ¶æ€
echo "ğŸ‘¤ å½“å‰ç™»å½•ç”¨æˆ·ï¼š"
who | awk '{print "  " $1 " (" $5 ")" }' | sort -u
echo

# 3. å¯†ç ç­–ç•¥æ£€æŸ¥
echo "ğŸ” å¯†ç ç­–ç•¥æ£€æŸ¥ï¼š"
awk -F: '$3 >= 1000 {print $1}' /etc/passwd | while read user; do
    aging_info=$(chage -l "$user" 2>/dev/null)
    max_days=$(echo "$aging_info" | grep "Maximum" | awk '{print $NF}')
    if [ "$max_days" = "99999" ]; then
        echo "  âš ï¸  $user: å¯†ç æ°¸ä¸è¿‡æœŸ"
    fi
done
echo

# 4. è¿‘æœŸç™»å½•æ´»åŠ¨
echo "ğŸ“… æœ€è¿‘ç™»å½•æ´»åŠ¨ï¼š"
last -n 10 | head -10
```

---

## 6. ğŸ›¡ï¸ ç”¨æˆ·ç®¡ç†å®‰å…¨åŠ å›ºæªæ–½


### 6.1 å¯†ç å®‰å…¨ç­–ç•¥


**å¼ºå¯†ç ç­–ç•¥é…ç½®**

ç¼–è¾‘ `/etc/pam.d/common-password` æˆ– `/etc/pam.d/passwd`ï¼š

```bash
# æ·»åŠ å¼ºå¯†ç è¦æ±‚
password requisite pam_pwquality.so retry=3 minlen=8 maxrepeat=2 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1

# å‚æ•°è§£é‡Šï¼š
# retry=3         : æœ€å¤šå°è¯•3æ¬¡
# minlen=8        : æœ€å°é•¿åº¦8ä½
# maxrepeat=2     : æœ€å¤šé‡å¤2ä¸ªç›¸åŒå­—ç¬¦
# ucredit=-1      : è‡³å°‘1ä¸ªå¤§å†™å­—æ¯
# lcredit=-1      : è‡³å°‘1ä¸ªå°å†™å­—æ¯  
# dcredit=-1      : è‡³å°‘1ä¸ªæ•°å­—
# ocredit=-1      : è‡³å°‘1ä¸ªç‰¹æ®Šå­—ç¬¦
```

**å¯†ç å†å²è®°å½•**

```bash
# é˜²æ­¢é‡å¤ä½¿ç”¨æœ€è¿‘5ä¸ªå¯†ç 
echo "password sufficient pam_unix.so remember=5" >> /etc/pam.d/common-password
```

### 6.2 ç™»å½•å®‰å…¨åŠ å›º


**é™åˆ¶rootç›´æ¥ç™»å½•**

```bash
# ç¦æ­¢rootç”¨æˆ·SSHç™»å½•
sed -i 's/#PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config
systemctl restart sshd

# é™åˆ¶rootåªèƒ½ä»æœ¬åœ°ç»ˆç«¯ç™»å½•
echo "tty1" > /etc/securetty
echo "tty2" >> /etc/securetty
```

**è®¾ç½®ç™»å½•æ¨ªå¹…**

```bash
# è®¾ç½®ç™»å½•å‰è­¦å‘Šä¿¡æ¯
cat > /etc/issue << EOF
*******************************************
*        æœªæˆæƒè®¿é—®å°†è¢«è¿½ç©¶è´£ä»»           *
*        Unauthorized access prohibited    *
*******************************************
EOF

# è®¾ç½®SSHç™»å½•æ¨ªå¹…
cat > /etc/motd << EOF
æ¬¢è¿è®¿é—®ç”Ÿäº§æœåŠ¡å™¨
æ‰€æœ‰æ“ä½œå°†è¢«è®°å½•å’Œå®¡è®¡
è¯·éµå®ˆå…¬å¸å®‰å…¨æ”¿ç­–
EOF
```

### 6.3 ç”¨æˆ·è¡Œä¸ºå®¡è®¡


**å¯ç”¨ç”¨æˆ·æ“ä½œè®°å½•**

```bash
# åœ¨ /etc/profile ä¸­æ·»åŠ æ“ä½œè®°å½•
cat >> /etc/profile << 'EOF'
# ç”¨æˆ·æ“ä½œè®°å½•
export HISTSIZE=10000
export HISTFILESIZE=10000
export HISTTIMEFORMAT="%F %T "
export PROMPT_COMMAND='history -a'

# è®°å½•ç”¨æˆ·æ“ä½œåˆ°syslog
export PROMPT_COMMAND='RETRN_VAL=$?;logger -p local6.debug "$(whoami) [$$]: $(history 1 | sed "s/^[ ]*[0-9]\+[ ]*//" ) [$RETRN_VAL]"'
EOF
```

**é…ç½®syslogè®°å½•ç”¨æˆ·æ“ä½œ**

```bash
# åœ¨ /etc/rsyslog.conf ä¸­æ·»åŠ 
echo "local6.*    /var/log/user_commands.log" >> /etc/rsyslog.conf
systemctl restart rsyslog

# è®¾ç½®æ—¥å¿—è½®è½¬
cat > /etc/logrotate.d/user_commands << EOF
/var/log/user_commands.log {
    weekly
    missingok
    rotate 52
    compress
    notifempty
    create 0644 root root
}
EOF
```

### 6.4 è´¦æˆ·å®‰å…¨æ£€æŸ¥


**å®šæœŸå®‰å…¨æ£€æŸ¥è„šæœ¬**

```bash
#!/bin/bash
# ç”¨æˆ·è´¦æˆ·å®‰å…¨æ£€æŸ¥

echo "=== ç”¨æˆ·è´¦æˆ·å®‰å…¨æ£€æŸ¥æŠ¥å‘Š ==="
echo "æ£€æŸ¥æ—¶é—´ï¼š$(date)"
echo

# 1. æ£€æŸ¥ç©ºå¯†ç è´¦æˆ·
echo "ğŸ” æ£€æŸ¥ç©ºå¯†ç è´¦æˆ·ï¼š"
awk -F: '($2 == "" || $2 == "!") {print "  âš ï¸  " $1 ": ç©ºå¯†ç æˆ–é”å®š"}' /etc/shadow
echo

# 2. æ£€æŸ¥UIDä¸º0çš„è´¦æˆ·ï¼ˆé™¤rootå¤–ï¼‰
echo "ğŸ” æ£€æŸ¥ç‰¹æƒè´¦æˆ·ï¼š"
awk -F: '$3 == 0 {print "  " $1}' /etc/passwd | grep -v "^root$" | while read user; do
    [ -n "$user" ] && echo "  âš ï¸  $user: UIDä¸º0çš„érootç”¨æˆ·"
done
echo

# 3. æ£€æŸ¥é•¿æœŸæœªç™»å½•è´¦æˆ·
echo "ğŸ” æ£€æŸ¥åƒµå°¸è´¦æˆ·ï¼ˆ90å¤©æœªç™»å½•ï¼‰ï¼š"
awk -F: '$3 >= 1000 {print $1}' /etc/passwd | while read user; do
    last_login=$(last -1 "$user" 2>/dev/null | head -1 | awk '{print $4,$5,$6}')
    if [ "$last_login" = "begins begins begins" ] || [ -z "$last_login" ]; then
        echo "  âš ï¸  $user: ä»æœªç™»å½•"
    fi
done
echo

# 4. æ£€æŸ¥sudoæƒé™
echo "ğŸ” æ£€æŸ¥sudoæƒé™ï¼š"
grep -E '^[^#].*ALL.*ALL' /etc/sudoers /etc/sudoers.d/* 2>/dev/null | while read line; do
    echo "  âš ï¸  $line"
done
```

**è‡ªåŠ¨åŒ–å®‰å…¨åŠ å›º**

```bash
#!/bin/bash
# è‡ªåŠ¨ç”¨æˆ·å®‰å…¨åŠ å›ºè„šæœ¬

echo "å¼€å§‹ç”¨æˆ·å®‰å…¨åŠ å›º..."

# 1. è®¾ç½®å¯†ç æœ€å¤§ä½¿ç”¨æœŸé™
echo "è®¾ç½®å…¨å±€å¯†ç ç­–ç•¥..."
sed -i 's/PASS_MAX_DAYS.*/PASS_MAX_DAYS   90/' /etc/login.defs
sed -i 's/PASS_MIN_DAYS.*/PASS_MIN_DAYS   7/' /etc/login.defs
sed -i 's/PASS_WARN_AGE.*/PASS_WARN_AGE   7/' /etc/login.defs

# 2. å¯¹ç°æœ‰ç”¨æˆ·åº”ç”¨å¯†ç ç­–ç•¥
awk -F: '$3 >= 1000 && $1 != "nobody" {print $1}' /etc/passwd | while read user; do
    chage -M 90 -m 7 -W 7 "$user"
done

# 3. è®¾ç½®ç™»å½•å¤±è´¥é”å®š
cat > /etc/security/faillock.conf << EOF
deny = 3
unlock_time = 300
fail_interval = 900
EOF

echo "ç”¨æˆ·å®‰å…¨åŠ å›ºå®Œæˆ"
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> ğŸ¯ **å¯†ç agingç®¡ç†**  
> ä½¿ç”¨`chage`å‘½ä»¤æ§åˆ¶å¯†ç ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬æœ€å°ä½¿ç”¨æœŸã€æœ€å¤§ä½¿ç”¨æœŸã€è­¦å‘ŠæœŸå’Œè¿‡æœŸå¤„ç†

> ğŸ”’ **è´¦æˆ·é”å®šæœºåˆ¶**  
> é€šè¿‡`faillock`å’ŒPAMæ¨¡å—å®ç°ç™»å½•å¤±è´¥è‡ªåŠ¨é”å®šï¼Œä½¿ç”¨`usermod -L/-U`æ‰‹åŠ¨é”å®šè§£é”

> ğŸ“Š **èµ„æºé™åˆ¶æ§åˆ¶**  
> ä½¿ç”¨`ulimit`å’Œ`/etc/security/limits.conf`é™åˆ¶ç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼Œé˜²æ­¢èµ„æºæ»¥ç”¨

> ğŸ‘¥ **ä¼šè¯ç®¡ç†**  
> ä½¿ç”¨`who`ã€`w`ã€`last`ç­‰å‘½ä»¤ç›‘æ§ç”¨æˆ·æ´»åŠ¨ï¼Œé€šè¿‡`pkill`ç®¡ç†ç”¨æˆ·ä¼šè¯

### 7.2 å…³é”®å®æˆ˜æŠ€èƒ½


**æ‰¹é‡ç”¨æˆ·æ“ä½œ**
```
âœ… ä½¿ç”¨è„šæœ¬æ‰¹é‡åˆ›å»º/åˆ é™¤ç”¨æˆ·
âœ… newuserså‘½ä»¤æ‰¹é‡å¯¼å…¥ç”¨æˆ·
âœ… æ‰¹é‡è®¾ç½®å¯†ç ç­–ç•¥å’Œç»„æƒé™
âœ… æ‰¹é‡ç”¨æˆ·ä¿¡æ¯ç»Ÿè®¡å’ŒæŠ¥å‘Š
```

**å®‰å…¨åŠ å›ºæªæ–½**
```
âœ… é…ç½®å¼ºå¯†ç ç­–ç•¥å’Œå†å²è®°å½•
âœ… è®¾ç½®ç™»å½•å¤±è´¥é”å®šå’Œè¶…æ—¶
âœ… å¯ç”¨ç”¨æˆ·æ“ä½œå®¡è®¡å’Œè®°å½•
âœ… å®šæœŸå®‰å…¨æ£€æŸ¥å’Œè‡ªåŠ¨åŒ–åŠ å›º
```

### 7.3 å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥


| åŠŸèƒ½åˆ†ç±» | æ ¸å¿ƒå‘½ä»¤ | ä¸»è¦ç”¨é€” | é‡è¦å‚æ•° |
|----------|----------|----------|----------|
| **å¯†ç ç­–ç•¥** | `chage` | å¯†ç agingç®¡ç† | `-M`æœ€å¤§å¤©æ•° `-m`æœ€å°å¤©æ•° `-W`è­¦å‘ŠæœŸ |
| **è´¦æˆ·é”å®š** | `faillock` | ç™»å½•å¤±è´¥ç®¡ç† | `--user` `--reset` |
| **èµ„æºé™åˆ¶** | `ulimit` | èµ„æºä½¿ç”¨æ§åˆ¶ | `-n`æ–‡ä»¶æ•° `-u`è¿›ç¨‹æ•° `-t`CPUæ—¶é—´ |
| **ä¼šè¯ç®¡ç†** | `who/w/last` | ç”¨æˆ·ä¼šè¯æŸ¥çœ‹ | `-u`è¯¦ç»†ä¿¡æ¯ `-n`æ•°é‡é™åˆ¶ |
| **æ‰¹é‡æ“ä½œ** | `newusers` | æ‰¹é‡åˆ›å»ºç”¨æˆ· | ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶æ ¼å¼ |

### 7.4 å®‰å…¨æœ€ä½³å®è·µ


**å¯†ç å®‰å…¨ç­–ç•¥**
- âœ… è®¾ç½®90å¤©å¯†ç è¿‡æœŸï¼Œ7å¤©æœ€å°é—´éš”
- âœ… å¯ç”¨å¯†ç å¤æ‚åº¦è¦æ±‚å’Œå†å²è®°å½•  
- âœ… å¼ºåˆ¶æ–°ç”¨æˆ·é¦–æ¬¡ç™»å½•æ›´æ”¹å¯†ç 
- âœ… å®šæœŸæ£€æŸ¥ç©ºå¯†ç å’Œå¼±å¯†ç è´¦æˆ·

**è®¿é—®æ§åˆ¶ç­–ç•¥**
- âœ… é…ç½®ç™»å½•å¤±è´¥3-5æ¬¡é”å®šè´¦æˆ·
- âœ… è®¾ç½®ä¼šè¯è¶…æ—¶å’Œå¹¶å‘ç™»å½•é™åˆ¶
- âœ… ç¦ç”¨æˆ–é™åˆ¶rootç›´æ¥ç™»å½•
- âœ… ä¸ºä¸åŒç”¨æˆ·ç»„è®¾ç½®åˆé€‚çš„èµ„æºé™åˆ¶

**å®¡è®¡ç›‘æ§ç­–ç•¥**
- âœ… å¯ç”¨ç”¨æˆ·æ“ä½œå‘½ä»¤è®°å½•åˆ°syslog
- âœ… å®šæœŸæ£€æŸ¥ç”¨æˆ·ç™»å½•å†å²å’Œå¼‚å¸¸è¡Œä¸º
- âœ… è‡ªåŠ¨åŒ–å®‰å…¨æ£€æŸ¥è„šæœ¬å®šæœŸæ‰§è¡Œ
- âœ… åŠæ—¶æ¸…ç†é•¿æœŸæœªä½¿ç”¨çš„åƒµå°¸è´¦æˆ·

> âš ï¸ **é‡è¦æé†’**  
> åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®æ–½è¿™äº›å®‰å…¨æªæ–½å‰ï¼ŒåŠ¡å¿…åœ¨æµ‹è¯•ç¯å¢ƒä¸­å……åˆ†éªŒè¯ï¼Œé¿å…å½±å“æ­£å¸¸ç”¨æˆ·ä½¿ç”¨

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- **å¯†ç ç®¡ç†**ï¼šchageè®¾ç­–ç•¥ï¼Œå®šæœŸè¦æ›´æ¢
- **è´¦æˆ·å®‰å…¨**ï¼šå¤±è´¥è¦é”å®šï¼Œèµ„æºè¦é™åˆ¶  
- **ä¼šè¯æ§åˆ¶**ï¼šè¶…æ—¶è¦è®¾ç½®ï¼Œæ´»åŠ¨è¦ç›‘æ§
- **æ‰¹é‡æ“ä½œ**ï¼šè„šæœ¬æ¥å¸®å¿™ï¼Œå®‰å…¨ä¸èƒ½å¿˜