---
title: 4、密码管理命令
---
## 📚 目录

1. [passwd命令基础操作](#1-passwd命令基础操作)
2. [密码复杂度策略配置](#2-密码复杂度策略配置)
3. [密码有效期管理](#3-密码有效期管理)
4. [用户密码锁定与解锁](#4-用户密码锁定与解锁)
5. [批量密码管理](#5-批量密码管理)
6. [密码安全策略](#6-密码安全策略)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔐 passwd命令基础操作


### 1.1 什么是passwd命令


**通俗理解**：
`passwd`命令就像是Linux系统的"密码管理器"，专门用来修改用户的登录密码。就好比你要更改手机锁屏密码一样，需要用特定的方式来操作。

**核心功能**：
- 修改当前用户密码
- 管理其他用户密码（需要root权限）
- 设置密码策略和限制
- 查看密码状态信息

### 1.2 基本使用方法


**个人密码修改**：
```bash
# 修改当前用户的密码
passwd

# 系统会提示输入：
# Current password: [输入当前密码]
# New password: [输入新密码] 
# Retype new password: [再次输入新密码]
```

> **💡 新手提醒**：输入密码时屏幕不会显示任何字符，这是正常的安全机制，你只管输入就行。

**管理员修改用户密码**：
```bash
# root用户可以修改任何用户的密码
passwd username

# 例如：修改张三的密码
passwd zhangsan
```

### 1.3 passwd命令常用选项


| 选项 | **含义** | **使用场景** | **示例** |
|------|---------|-------------|----------|
| `-l` | **锁定账户** | `暂时禁用用户登录` | `passwd -l zhangsan` |
| `-u` | **解锁账户** | `恢复用户登录权限` | `passwd -u zhangsan` |
| `-d` | **删除密码** | `设置空密码（危险）` | `passwd -d zhangsan` |
| `-S` | **查看状态** | `检查密码信息` | `passwd -S zhangsan` |
| `-e` | **强制过期** | `下次登录必须改密码` | `passwd -e zhangsan` |

---

## 2. 🔒 密码复杂度策略配置


### 2.1 为什么需要密码复杂度


**生活类比**：
就像你的银行卡密码不能设置成"123456"一样，系统密码也需要足够复杂才能保证安全。简单密码就像用一把塑料锁锁保险箱，很容易被破解。

### 2.2 PAM密码质量控制


**什么是PAM**：
PAM（可插拔认证模块）就像是Linux的"安全检查员"，专门负责检查密码是否符合安全要求。

**配置文件位置**：
```bash
# 主要配置文件
/etc/pam.d/passwd
/etc/security/pwquality.conf
```

### 2.3 配置密码复杂度规则


**编辑pwquality.conf文件**：
```bash
# 编辑密码质量配置
vim /etc/security/pwquality.conf
```

**常用密码策略配置**：
```
# 最小密码长度
minlen = 8

# 至少包含几个字符类别（大写、小写、数字、特殊字符）
minclass = 3

# 最少数字个数
dcredit = -1

# 最少小写字母个数  
lcredit = -1

# 最少大写字母个数
ucredit = -1

# 最少特殊字符个数
ocredit = -1

# 禁止使用用户名
reject_username

# 禁止使用简单的重复字符
maxrepeat = 2
```

> **💭 记忆技巧**：
> - `minlen` = 最小长度（minimum length）
> - `dcredit` = 数字积分（digit credit），负数表示至少需要几个
> - `lcredit` = 小写字母积分（lowercase credit）
> - `ucredit` = 大写字母积分（uppercase credit） 
> - `ocredit` = 其他字符积分（other credit）

### 2.4 测试密码复杂度


**检查当前密码策略**：
```bash
# 查看当前PAM配置
cat /etc/pam.d/passwd

# 测试密码强度
pwscore
# 然后输入你想测试的密码，系统会给出评分
```

---

## 3. 📅 密码有效期管理


### 3.1 密码有效期的意义


**为什么要设置有效期**：
就像身份证有有效期一样，密码也应该定期更换。长期不换密码就像一直用同一把钥匙，时间久了别人可能会偷配，存在安全隐患。

### 3.2 chage命令详解


**chage命令用途**：
`chage`（change age）专门用来管理用户密码的"年龄信息"，包括何时过期、何时必须更改等。

**基本语法**：
```bash
chage [选项] 用户名
```

### 2.3 chage常用选项


| 选项 | **含义** | **说明** | **示例** |
|------|---------|---------|----------|
| `-l` | **查看信息** | `显示用户密码详细信息` | `chage -l zhangsan` |
| `-m` | **最小天数** | `两次改密码的最小间隔` | `chage -m 7 zhangsan` |
| `-M` | **最大天数** | `密码有效期（多少天后过期）` | `chage -M 90 zhangsan` |
| `-W` | **警告天数** | `过期前几天开始警告` | `chage -W 7 zhangsan` |
| `-E` | **账户过期** | `设置账户过期日期` | `chage -E 2024-12-31 zhangsan` |
| `-d` | **最后修改** | `设置密码最后修改日期` | `chage -d 0 zhangsan` |

**实际操作示例**：
```bash
# 查看用户zhangsan的密码信息
chage -l zhangsan

# 设置密码90天后过期
chage -M 90 zhangsan

# 设置密码过期前7天开始警告
chage -W 7 zhangsan

# 强制用户下次登录时修改密码
chage -d 0 zhangsan
```

### 3.4 批量设置密码有效期


**为所有用户设置统一策略**：
```bash
# 编辑默认密码策略文件
vim /etc/login.defs
```

**关键配置项**：
```
# 密码最大有效天数
PASS_MAX_DAYS 90

# 密码最小修改间隔
PASS_MIN_DAYS 7  

# 过期前警告天数
PASS_WARN_AGE 7

# 最小密码长度
PASS_MIN_LEN 8
```

> **⚠️ 重要提醒**：`/etc/login.defs`中的设置只对新创建的用户生效，已存在的用户需要用`chage`命令单独设置。

---

## 4. 🔐 用户密码锁定与解锁


### 4.1 什么时候需要锁定用户


**常见场景**：
- 员工临时离职，但可能回来
- 发现账户存在安全风险
- 用户违规，需要暂停使用权限
- 系统维护期间限制登录

**生活类比**：
就像银行卡被多次输错密码后会被冻结一样，Linux也可以主动锁定用户账户。

### 4.2 密码锁定方法


**使用passwd命令锁定**：
```bash
# 锁定用户zhangsan
passwd -l zhangsan

# 查看锁定状态
passwd -S zhangsan
# 输出：zhangsan L 2024-09-18 0 99999 7 -1
# L表示locked（已锁定）
```

**使用usermod命令锁定**：
```bash
# 锁定用户账户
usermod -L zhangsan

# 同时设置账户过期日期
usermod -L -e 2024-12-31 zhangsan
```

### 4.3 密码解锁方法


**解锁用户账户**：
```bash
# 使用passwd解锁
passwd -u zhangsan

# 使用usermod解锁
usermod -U zhangsan

# 解锁后查看状态
passwd -S zhangsan
# 输出：zhangsan P 2024-09-18 0 99999 7 -1  
# P表示Password（正常状态）
```

### 4.4 账户锁定状态检查


**检查系统中被锁定的账户**：
```bash
# 方法1：查看/etc/shadow文件
awk -F: '$2 ~ /^!/ {print $1 " is locked"}' /etc/shadow

# 方法2：使用passwd -S检查所有用户
for user in $(cut -d: -f1 /etc/passwd); do
    echo -n "$user: "
    passwd -S $user 2>/dev/null | awk '{print $2}'
done
```

---

## 5. 👥 批量密码管理


### 5.1 为什么需要批量管理


**实际场景**：
- 新学期为所有学生重置密码
- 公司新入职员工批量开户
- 定期更换系统账户密码
- 安全事件后的应急处理

### 5.2 chpasswd命令批量设置


**chpasswd命令用途**：
`chpasswd`可以从标准输入读取"用户名:密码"的格式，批量设置多个用户的密码。

**基本使用方法**：
```bash
# 创建密码文件
vim passwords.txt

# 文件内容格式：用户名:密码
zhangsan:NewPass123
lisi:SecurePass456
wangwu:StrongPass789

# 批量设置密码
chpasswd < passwords.txt
```

### 5.3 批量密码生成


**生成随机密码脚本**：
```bash
#!/bin/bash
# 批量生成用户密码

# 用户列表
users=("zhangsan" "lisi" "wangwu")

for user in "${users[@]}"; do
    # 生成8位随机密码
    password=$(openssl rand -base64 8)
    echo "$user:$password" | chpasswd
    echo "用户 $user 的新密码是: $password"
done
```

**使用pwgen工具**：
```bash
# 安装pwgen（如果没有）
yum install pwgen    # CentOS/RHEL
apt install pwgen    # Ubuntu/Debian

# 生成密码
pwgen -s 12 1    # 生成1个12位的安全密码
```

### 5.4 批量密码重置策略


**制定重置计划**：

```
📋 **密码重置检查清单**
- [ ] 确定需要重置的用户范围
- [ ] 生成符合复杂度要求的新密码
- [ ] 备份当前密码哈希值（如果需要）
- [ ] 执行批量重置操作
- [ ] 通知用户新密码（安全方式）
- [ ] 强制用户首次登录时修改密码
```

**安全的密码分发方式**：
- 通过加密邮件发送
- 打印后当面交付
- 使用临时密码+强制修改
- 短信发送（仅适用于个人账户）

---

## 6. 🛡️ 密码安全策略


### 6.1 空密码的风险与管理


**空密码的危险性**：
设置空密码就像把家门钥匙扔掉，任何人都可以随意进入。这在生产环境中是绝对不允许的。

**检查空密码用户**：
```bash
# 查找空密码的用户
awk -F: '$2 == "" {print $1 " has empty password"}' /etc/shadow
```

**紧急处理空密码**：
```bash
# 为空密码用户设置密码
passwd username

# 或者先锁定再设置
passwd -l username
passwd username
passwd -u username
```

### 6.2 密码历史记录管理


**什么是密码历史**：
系统可以记住用户之前使用过的密码，防止用户总是使用相同的几个密码循环使用。

**配置密码历史**：
```bash
# 编辑PAM配置文件
vim /etc/pam.d/passwd

# 添加记住最近5个密码的配置
password required pam_pwhistory.so remember=5
```

**查看密码历史文件**：
```bash
# 密码历史存储位置
ls -la /etc/security/opasswd
```

### 6.3 密码强制策略实施


**组合策略配置示例**：

```
🔧 **企业级密码策略配置**

/etc/security/pwquality.conf:
- 最小长度：12位
- 必须包含：大小写字母、数字、特殊字符
- 不能包含用户名
- 不能重复超过2个字符

/etc/login.defs:
- 密码有效期：90天
- 最小修改间隔：1天
- 过期前警告：7天

PAM配置:
- 记住最近8个密码
- 连续失败5次后锁定30分钟
```

### 6.4 密码安全最佳实践


**制定密码规范**：

```
📝 **密码安全指南**

强密码特征：
• 长度至少12位
• 包含大小写字母、数字、特殊符号
• 不包含个人信息（姓名、生日等）
• 不使用常见密码（123456、password等）
• 定期更换（建议3个月）

管理建议：
• 不同系统使用不同密码
• 重要账户启用双因子认证
• 定期检查密码强度
• 建立密码恢复机制
```

**密码审计脚本**：
```bash
#!/bin/bash
# 密码安全检查脚本

echo "🔍 检查密码安全状态..."

# 检查空密码用户
echo "空密码用户："
awk -F: '$2 == "" {print "❌ " $1}' /etc/shadow

# 检查长期未更改密码的用户
echo -e "\n长期未更改密码的用户（超过90天）："
for user in $(cut -d: -f1 /etc/passwd); do
    lastchange=$(chage -l $user 2>/dev/null | grep "Last password change" | cut -d: -f2)
    if [[ "$lastchange" != *"never"* ]]; then
        # 这里可以添加日期计算逻辑
        echo "🔶 $user: $lastchange"
    fi
done

# 检查被锁定的用户
echo -e "\n被锁定的用户："
awk -F: '$2 ~ /^!/ {print "🔒 " $1}' /etc/shadow
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 passwd命令：Linux密码管理的核心工具
🔸 密码复杂度：通过PAM模块控制密码质量
🔸 有效期管理：使用chage命令设置密码生命周期
🔸 账户锁定：临时禁用用户登录的安全措施
🔸 批量管理：chpasswd命令处理多用户密码操作
🔸 安全策略：综合运用各种机制保障系统安全
```

### 7.2 关键理解要点


**🔹 passwd vs chage的区别**
```
passwd：主要用于修改密码内容
• 设置新密码
• 锁定/解锁账户  
• 删除密码

chage：主要用于管理密码策略
• 设置有效期
• 配置过期时间
• 管理修改间隔
```

**🔹 密码安全层次**
```
基础层：设置复杂密码
策略层：配置有效期和复杂度要求
管理层：批量管理和定期审计
监控层：实时监控异常登录
```

### 7.3 实际应用价值


**运维场景应用**：
- **系统管理员**：批量创建用户账户，统一密码策略
- **安全管理员**：定期检查密码强度，处理安全事件
- **企业IT**：员工入职离职的账户管理
- **学校机房**：学生账户的批量管理和重置

**安全防护意义**：
- 防止弱密码导致的系统入侵
- 通过定期更换降低密码泄露风险
- 锁定机制防止暴力破解攻击
- 历史记录避免密码重复使用

### 7.4 常用命令速查


**日常操作命令**：
```bash
# 修改密码
passwd [username]

# 查看密码状态  
passwd -S username

# 锁定/解锁账户
passwd -l username    # 锁定
passwd -u username    # 解锁

# 管理密码有效期
chage -l username     # 查看信息
chage -M 90 username  # 90天过期
chage -d 0 username   # 强制下次修改

# 批量设置密码
chpasswd < passwords.txt
```

**🧠 记忆口诀**：
```
passwd改密码，chage管时效
锁定用-l，解锁用-u
复杂度配pwquality，有效期看login.defs
批量管理chpasswd，安全检查要常做
```

**核心要点**：
- 密码管理是Linux系统安全的基础
- 要平衡安全性和可用性
- 定期审计和更新密码策略
- 批量操作时务必谨慎小心
- 建立完善的密码管理制度