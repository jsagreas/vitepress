---
title: 14、用户登录信息查看
---
## 📚 目录

1. [用户登录信息查看概述](#1-用户登录信息查看概述)
2. [当前登录用户查看](#2-当前登录用户查看)
3. [用户活动详情监控](#3-用户活动详情监控)
4. [登录历史记录查询](#4-登录历史记录查询)
5. [系统登录日志文件](#5-系统登录日志文件)
6. [用户详细信息查看](#6-用户详细信息查看)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔍 用户登录信息查看概述


### 1.1 什么是用户登录信息


**简单理解**：就像宾馆的登记本一样，Linux系统会详细记录谁什么时候登录了系统，在做什么，什么时候离开的。

> 💡 **核心概念**：用户登录信息是Linux系统安全管理的重要组成部分
> 
> 通过这些信息，系统管理员可以：
> - 了解系统使用情况
> - 发现异常登录行为
> - 进行安全审计
> - 排查系统问题

### 1.2 为什么要查看登录信息


**实际场景**：
- 🔒 **安全监控**：发现未授权登录
- 📊 **系统管理**：了解用户使用习惯
- 🐛 **问题排查**：追踪操作记录
- 📋 **审计要求**：满足合规需求

### 1.3 登录信息的类型


```
登录信息分类：

🔸 当前状态信息
• 谁现在登录着
• 从哪里登录的
• 在做什么

🔸 历史记录信息  
• 谁曾经登录过
• 什么时候登录的
• 登录持续多长时间

🔸 详细用户信息
• 用户基本资料
• 最后登录时间
• 用户活动统计
```

---

## 2. 👥 当前登录用户查看


### 2.1 who命令 - 查看当前登录用户


**基本含义**：`who`命令用来显示当前正在登录系统的所有用户信息。

**基本语法**：
```bash
who [选项]
```

**常用示例**：

| 命令 | 说明 | 输出示例 |
|------|------|----------|
| `who` | 显示当前登录用户 | `root pts/0 2024-01-21 10:30` |
| `who -b` | 显示系统启动时间 | `system boot 2024-01-21 08:00` |
| `who -r` | 显示当前运行级别 | `run-level 3 2024-01-21 08:00` |
| `who -q` | 只显示用户名和数量 | `root admin # users=2` |

**输出信息解读**：
```
输出格式：用户名 终端 登录时间 (登录来源)

root     pts/0        2024-01-21 10:30 (192.168.1.100)
│        │            │                 │
│        │            │                 └─ 登录来源IP
│        │            └─ 登录时间
│        └─ 终端类型（pts表示远程终端）
└─ 用户名
```

### 2.2 users命令 - 简单用户列表


**基本含义**：`users`是最简单的查看当前登录用户的命令，只显示用户名。

```bash
users
# 输出：root admin guest
```

**适用场景**：
- ✅ 快速了解有多少人在线
- ✅ 脚本中简单统计
- ✅ 不需要详细信息时使用

---

## 3. 📊 用户活动详情监控


### 3.1 w命令 - 用户活动详情


**基本含义**：`w`命令显示当前登录用户及其正在执行的任务，是`who`命令的增强版本。

**输出信息解读**：
```bash
w
```

```
 10:45:23 up  2:45,  2 users,  load average: 0.15, 0.05, 0.01
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
root     pts/0    192.168.1.100    10:30    0.00s  0.04s  0.00s w
admin    pts/1    192.168.1.101    10:40    5:00   0.02s  0.02s vim file.txt
```

**详细字段说明**：

| 字段 | 含义 | 解释 |
|------|------|------|
| **USER** | 用户名 | 登录的用户账号 |
| **TTY** | 终端 | 用户使用的终端设备 |
| **FROM** | 来源 | 登录的来源地址 |
| **LOGIN@** | 登录时间 | 用户登录的时间 |
| **IDLE** | 空闲时间 | 用户最后一次活动到现在的时间 |
| **JCPU** | 作业CPU时间 | 该终端上所有进程占用的CPU时间 |
| **PCPU** | 进程CPU时间 | 当前进程占用的CPU时间 |
| **WHAT** | 当前活动 | 用户当前正在执行的命令 |

### 3.2 系统负载信息理解


**负载平均值解读**：
```
load average: 0.15, 0.05, 0.01
             │     │     │
             │     │     └─ 15分钟平均负载
             │     └─ 5分钟平均负载  
             └─ 1分钟平均负载

负载值含义：
• 0.00：系统完全空闲
• 1.00：系统满负荷运行（单核）
• > 1.00：系统过载
```

### 3.3 w命令实用选项


| 选项 | 说明 | 示例 |
|------|------|------|
| `w -h` | 不显示标题行 | 只显示用户信息 |
| `w -s` | 简短格式输出 | 省略JCPU和PCPU |
| `w -f` | 显示远程主机名 | 显示完整主机名而非IP |
| `w 用户名` | 只显示指定用户 | `w root` |

---

## 4. 📜 登录历史记录查询


### 4.1 last命令 - 登录历史记录


**基本含义**：`last`命令用来查看用户的登录历史记录，包括成功和失败的登录尝试。

**基本用法**：
```bash
last [选项] [用户名] [终端]
```

**常用示例**：

```bash
# 查看所有用户的登录记录
last

# 查看特定用户的登录记录
last root

# 查看最近5次登录记录
last -5

# 查看指定日期的登录记录
last -s "2024-01-20" -t "2024-01-21"
```

**输出示例解读**：
```
root     pts/0        192.168.1.100    Sun Jan 21 10:30   still logged in
admin    pts/1        192.168.1.101    Sun Jan 21 10:40 - 11:00  (00:20)
root     console                       Sun Jan 21 08:00 - 10:30  (02:30)
reboot   system boot  4.18.0-348       Sun Jan 21 08:00   still running

字段含义：
用户名    终端        来源IP           登录时间          登录持续时间
```

### 4.2 lastlog命令 - 最后登录时间


**基本含义**：`lastlog`命令显示系统中每个用户的最后登录时间。

```bash
# 显示所有用户的最后登录时间
lastlog

# 显示特定用户的最后登录时间
lastlog -u root

# 显示最近7天内登录过的用户
lastlog -t 7
```

**输出示例**：
```
Username         Port     From             Latest
root             pts/0    192.168.1.100    Sun Jan 21 10:30:45 +0800 2024
admin            pts/1    192.168.1.101    Sun Jan 21 10:40:12 +0800 2024
guest                                      **Never logged in**
```

### 4.3 登录失败记录查看


**lastb命令**：查看失败的登录尝试
```bash
# 需要root权限
sudo lastb

# 查看特定用户的失败登录
sudo lastb root
```

> ⚠️ **安全提醒**：经常检查失败登录记录，可以及时发现暴力破解攻击
> 
> 如果发现大量失败登录尝试，应该：
> - 检查是否为合法用户操作
> - 考虑加强密码策略
> - 启用登录失败锁定机制

---

## 5. 📁 系统登录日志文件


### 5.1 重要日志文件位置


**核心日志文件**：

| 文件路径 | 作用 | 格式 |
|---------|------|------|
| `/var/log/wtmp` | 用户登录/登出记录 | 二进制文件 |
| `/var/log/btmp` | 失败登录记录 | 二进制文件 |
| `/var/log/lastlog` | 每个用户最后登录信息 | 二进制文件 |
| `/var/log/utmp` | 当前登录用户信息 | 二进制文件 |

### 5.2 /var/log/wtmp文件详解


**文件特点**：
- 📝 记录所有用户的登录和登出信息
- 🔒 二进制格式，不能直接查看
- 📈 文件会不断增长，需要定期轮转

**查看方法**：
```bash
# 使用last命令查看（推荐）
last

# 查看文件信息
ls -lh /var/log/wtmp

# 查看文件最后修改时间
stat /var/log/wtmp
```

### 5.3 /var/log/lastlog文件特点


**文件结构**：
- 🗂️ 为每个UID分配固定长度的记录
- ⚡ 查找速度快（直接定位）
- 💾 即使用户从未登录也占用空间

```bash
# 文件大小通常很大
ls -lh /var/log/lastlog
# -rw-r--r-- 1 root utmp 292K Jan 21 10:45 /var/log/lastlog

# 实际使用空间（稀疏文件）
du -h /var/log/lastlog
# 32K    /var/log/lastlog
```

### 5.4 日志文件管理


**日志轮转**：
```bash
# 查看日志轮转配置
cat /etc/logrotate.conf

# wtmp日志轮转配置示例
/var/log/wtmp {
    monthly
    create 0664 root utmp
    rotate 1
}
```

**手动清理**：
```bash
# 清空wtmp文件（需谨慎）
sudo truncate -s 0 /var/log/wtmp

# 备份重要日志
sudo cp /var/log/wtmp /var/log/wtmp.backup
```

---

## 6. 🔍 用户详细信息查看


### 6.1 finger命令 - 用户信息查看


**基本含义**：`finger`命令用来查看用户的详细信息，包括登录状态、个人资料等。

> ⚠️ **注意事项**：现代Linux发行版中，finger命令可能需要单独安装
> 
> 安装方法：
> - Ubuntu/Debian: `sudo apt-get install finger`
> - CentOS/RHEL: `sudo yum install finger`

**基本用法**：
```bash
# 查看所有当前登录用户的详细信息
finger

# 查看特定用户信息
finger root

# 查看远程用户信息（如果允许）
finger user@hostname
```

**输出示例**：
```bash
finger root
```

```
Login: root                             Name: root
Directory: /root                        Shell: /bin/bash
On since Sun Jan 21 10:30 (CST) on pts/0 from 192.168.1.100
   No mail.
No Plan.
```

**信息字段说明**：
- **Login**: 用户登录名
- **Name**: 用户全名（GECOS字段）
- **Directory**: 用户主目录
- **Shell**: 用户默认Shell
- **On since**: 登录时间和终端
- **Mail**: 邮件状态
- **Plan**: 用户计划文件内容

### 6.2 id命令 - 用户身份信息


**基本含义**：`id`命令显示用户的UID、GID和所属组信息。

```bash
# 显示当前用户身份信息
id

# 显示指定用户身份信息
id username

# 只显示用户ID
id -u

# 只显示组ID
id -g
```

**输出示例**：
```
id root
uid=0(root) gid=0(root) groups=0(root)

解释：
• uid=0(root)：用户ID是0，用户名是root
• gid=0(root)：主组ID是0，组名是root  
• groups=0(root)：所属组列表
```

### 6.3 whoami命令 - 当前用户名


**最简单的用户查看**：
```bash
whoami
# 输出：root
```

**应用场景**：
- ✅ 脚本中确认当前用户
- ✅ 快速确认身份切换是否成功
- ✅ 与`su`、`sudo`命令配合使用

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心命令


```
🔸 基础查看命令
• who：当前登录用户基本信息
• w：用户活动详情（最实用）
• users：简单用户名列表
• whoami：当前用户名

🔸 历史记录命令
• last：登录历史记录
• lastlog：最后登录时间
• lastb：失败登录记录（需root权限）

🔸 详细信息命令
• finger：用户详细信息
• id：用户身份和组信息
```

### 7.2 关键概念理解


**终端类型识别**：
```
终端类型说明：
• console：本地控制台
• pts/0：伪终端（SSH、telnet等远程连接）
• tty1：本地虚拟终端
```

**时间格式理解**：
- 🕐 **登录时间**：用户开始登录的时间
- ⏰ **空闲时间**：用户最后活动到现在的时间
- ⏱️ **持续时间**：登录总时长

### 7.3 实际应用场景


**日常管理**：
- 🔍 **检查系统使用情况**：`w`命令查看用户活动
- 📊 **统计登录频率**：`last | head -20`查看最近登录
- 🔒 **安全审计**：`lastb`检查失败登录
- 📋 **用户管理**：`finger`查看用户详细信息

**故障排查**：
- 🐛 **系统负载高**：用`w`查看用户正在做什么
- 🔍 **异常登录**：用`last`追踪登录记录
- ⚠️ **权限问题**：用`id`确认用户身份

### 7.4 安全注意事项


> 🔒 **安全最佳实践**
> 
> 1. **定期检查**：每天查看`w`和`last`输出
> 2. **关注异常**：注意非正常时间的登录
> 3. **监控失败**：定期检查`lastb`失败记录
> 4. **日志保护**：确保日志文件权限正确设置

### 7.5 快速参考表


| 需求 | 推荐命令 | 说明 |
|------|----------|------|
| 快速查看在线用户 | `who` | 基本信息足够 |
| 查看用户在做什么 | `w` | 最详细实用 |
| 追踪登录历史 | `last` | 安全审计必备 |
| 检查用户信息 | `finger 用户名` | 详细资料查看 |
| 脚本中获取用户名 | `whoami` | 简单可靠 |

### 7.6 学习要点


**记忆技巧**：
- `who` → 谁在线（基础信息）
- `w` → 在做什么（What，详细活动）  
- `last` → 最近登录（历史记录）
- `finger` → 手指指向（详细信息）

**实践建议**：
1. **每天习惯**：登录系统后先运行`w`了解情况
2. **定期检查**：每周查看`last`了解系统使用模式
3. **安全意识**：发现异常立即调查
4. **命令组合**：多个命令结合使用获得完整信息

**核心理解**：
- 用户登录信息查看是Linux系统管理的基础技能
- 不同命令提供不同层次的信息，按需选择
- 日志文件是信息的最终来源，命令只是查看工具
- 安全监控需要将这些命令结合起来使用