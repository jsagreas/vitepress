---
title: 13、服务状态信息查看
---
## 📚 目录

1. [systemctl服务状态查看](#1-systemctl服务状态查看)
2. [systemctl运行单元管理](#2-systemctl运行单元管理)
3. [传统service命令](#3-传统service命令)
4. [chkconfig配置查看](#4-chkconfig配置查看)
5. [系统内核参数查看](#5-系统内核参数查看)
6. [运行级别管理](#6-运行级别管理)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔧 systemctl服务状态查看


### 1.1 什么是systemctl


**🔸 基本概念**
`systemctl`是现代Linux系统（使用systemd）的服务管理工具，可以理解为"系统控制器"。它就像是一个管家，负责启动、停止、重启各种系统服务，并能告诉你每个服务现在的状态。

**💡 为什么要用systemctl**
想象你家里有很多电器设备，你需要知道哪些开着、哪些关着、哪些出了故障。systemctl就是帮你管理Linux系统中所有"服务设备"的工具。

### 1.2 查看服务状态


**🎯 基本语法**
```bash
systemctl status [服务名]
```

**📊 实用示例**
```bash
# 查看SSH服务状态
systemctl status ssh

# 查看Apache网页服务状态  
systemctl status apache2

# 查看MySQL数据库状态
systemctl status mysql

# 查看防火墙状态
systemctl status ufw
```

### 1.3 状态信息解读


**📋 状态输出示例**
```
● ssh.service - OpenBSD Secure Shell server
   Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)
   Active: active (running) since Mon 2025-01-20 10:30:15 UTC; 2h 15min ago
   Docs: man:sshd(8)
         man:sshd_config(5)
 Main PID: 1234 (sshd)
    Tasks: 1 (limit: 4915)
   Memory: 2.1M
   CGroup: /system.slice/ssh.service
           └─1234 /usr/sbin/sshd -D
```

**🔍 关键字段含义**
- **Loaded**: 服务配置文件是否加载成功
- **Active**: 当前运行状态
  - `active (running)` = 正在运行
  - `inactive (dead)` = 已停止
  - `failed` = 运行失败
- **Main PID**: 主进程ID号
- **Memory**: 内存占用情况

### 1.4 快速状态检查


**⚡ 简化状态查看**
```bash
# 只显示服务是否运行（不显示详细信息）
systemctl is-active ssh        # 输出: active 或 inactive
systemctl is-enabled ssh       # 输出: enabled 或 disabled
systemctl is-failed ssh        # 输出: active 或 failed
```

> 💡 **使用场景**: 这些命令特别适合在脚本中使用，因为只返回简单的状态词，便于编程判断。

---

## 2. 📦 systemctl运行单元管理


### 2.1 什么是运行单元


**🔸 单元概念**
在systemd中，"单元(Unit)"是最基本的管理对象。可以把它理解为系统中需要管理的各种"组件"，就像乐高积木的每个块都是一个单元。

**📋 单元类型**
```
┌─────────────┬─────────────────────┐
│   单元类型   │      作用说明        │
├─────────────┼─────────────────────┤
│ .service    │ 系统服务程序        │
│ .socket     │ 网络套接字监听      │
│ .target     │ 启动目标组合        │
│ .mount      │ 文件系统挂载点      │
│ .timer      │ 定时任务            │
│ .path       │ 文件路径监控        │
└─────────────┴─────────────────────┘
```

### 2.2 查看运行中的单元


**🔧 list-units命令**
```bash
# 查看所有正在运行的单元
systemctl list-units

# 只查看服务类型的单元
systemctl list-units --type=service

# 查看失败的单元
systemctl list-units --failed

# 查看所有单元（包括未运行的）
systemctl list-units --all
```

**📊 输出示例**
```
UNIT                    LOAD   ACTIVE SUB     DESCRIPTION
ssh.service            loaded active running OpenBSD Secure Shell server
apache2.service        loaded active running The Apache HTTP Server
mysql.service          loaded failed failed  MySQL Community Server
NetworkManager.service loaded active running Network Manager
```

### 2.3 查看单元文件配置


**📁 list-unit-files命令**
```bash
# 查看所有单元文件的启用状态
systemctl list-unit-files

# 只查看服务类型的单元文件
systemctl list-unit-files --type=service

# 查看已启用的单元文件
systemctl list-unit-files --state=enabled
```

**🔍 状态含义**
- **enabled**: 开机自启动
- **disabled**: 不自启动
- **static**: 被其他服务依赖时启动
- **masked**: 被屏蔽，无法启动

> ⚠️ **注意**: `list-units`显示当前运行状态，`list-unit-files`显示配置文件状态，两者作用不同。

---

## 3. 🔄 传统service命令


### 3.1 service命令简介


**🔸 历史背景**
`service`是传统Linux系统（使用SysV init）的服务管理命令。虽然现代系统主要使用systemctl，但service命令仍然可用，并且在某些情况下更加简洁。

**💡 两者关系**
可以把service理解为systemctl的"简化版"，很多Linux老用户仍然习惯使用service命令。

### 3.2 基本用法


**⚡ 常用service命令**
```bash
# 查看服务状态
service ssh status
service apache2 status

# 启动服务
service ssh start

# 停止服务  
service ssh stop

# 重启服务
service ssh restart

# 查看所有服务状态
service --status-all
```

### 3.3 service与systemctl对比


**📊 命令对比表**

| **功能** | **service命令** | **systemctl命令** |
|----------|-----------------|-------------------|
| 查看状态 | `service ssh status` | `systemctl status ssh` |
| 启动服务 | `service ssh start` | `systemctl start ssh` |
| 停止服务 | `service ssh stop` | `systemctl stop ssh` |
| 重启服务 | `service ssh restart` | `systemctl restart ssh` |
| 查看所有 | `service --status-all` | `systemctl list-units` |

> 💡 **选择建议**: 新手建议主要学习systemctl，因为它功能更强大且是未来趋势。但了解service命令也很有用。

---

## 4. ⚙️ chkconfig配置查看


### 4.1 chkconfig命令作用


**🔸 基本概念**
`chkconfig`是传统Linux系统中用于管理服务开机自启动的工具。它的作用就是告诉系统"这个服务要不要在开机时自动启动"。

**📋 运行级别概念**
Linux系统有不同的运行模式，每个模式叫一个"运行级别"：

```
运行级别说明：
0 - 关机
1 - 单用户模式（类似安全模式）
2 - 多用户模式（无网络）
3 - 完整多用户模式（有网络，命令行）
4 - 未使用
5 - 图形界面模式
6 - 重启
```

### 4.2 基本使用方法


**🔧 常用chkconfig命令**
```bash
# 查看所有服务的自启动状态
chkconfig --list

# 查看特定服务的自启动状态
chkconfig --list ssh

# 设置服务开机自启动
chkconfig ssh on

# 取消服务开机自启动
chkconfig ssh off
```

### 4.3 输出信息解读


**📊 输出示例**
```bash
$ chkconfig --list
ssh             0:off   1:off   2:on    3:on    4:on    5:on    6:off
apache2         0:off   1:off   2:off   3:off   4:off   5:off   6:off
mysql           0:off   1:off   2:on    3:on    4:on    5:on    6:off
```

**🔍 含义解释**
- `ssh 2:on 3:on 5:on` = SSH服务在运行级别2、3、5下会自动启动
- `apache2` 全部是off = Apache服务不会自动启动，需要手动启动

> ⚠️ **现代系统注意**: 很多新版Linux系统已经不使用chkconfig，而是用`systemctl enable/disable`来管理自启动。

---

## 5. 🔍 系统内核参数查看


### 5.1 /proc/sys目录详解


**🔸 什么是/proc/sys**
`/proc/sys`是一个特殊的目录，它就像系统的"控制面板"，里面存放着各种系统运行参数。这些参数直接影响系统的行为和性能。

**📁 目录结构**
```
/proc/sys/
├── kernel/     # 内核相关参数
├── net/        # 网络相关参数  
├── vm/         # 虚拟内存参数
├── fs/         # 文件系统参数
└── dev/        # 设备相关参数
```

### 5.2 查看内核参数


**🔧 查看方法**
```bash
# 查看所有内核参数
cat /proc/sys/kernel/*

# 查看特定参数
cat /proc/sys/kernel/hostname          # 主机名
cat /proc/sys/kernel/version           # 内核版本
cat /proc/sys/kernel/pid_max           # 最大进程ID

# 查看网络参数
cat /proc/sys/net/ipv4/ip_forward      # IP转发是否开启
cat /proc/sys/net/core/somaxconn       # socket最大连接数
```

**📊 实用参数示例**
```bash
# 系统相关
/proc/sys/kernel/hostname              # 计算机名称
/proc/sys/kernel/osrelease             # 操作系统版本
/proc/sys/kernel/threads-max           # 最大线程数

# 网络相关  
/proc/sys/net/ipv4/tcp_keepalive_time  # TCP连接保持时间
/proc/sys/net/ipv4/tcp_max_syn_backlog # TCP SYN队列最大长度

# 内存相关
/proc/sys/vm/swappiness                # swap使用倾向度
/proc/sys/vm/dirty_ratio               # 脏页比例
```

### 5.3 sysctl系统参数管理


**🔸 sysctl命令介绍**
`sysctl`是更友好的系统参数管理工具，它比直接读取`/proc/sys`文件更方便，还可以修改参数。

**⚡ 基本用法**
```bash
# 查看所有系统参数
sysctl -a

# 查看特定参数
sysctl kernel.hostname
sysctl net.ipv4.ip_forward
sysctl vm.swappiness

# 搜索相关参数
sysctl -a | grep tcp
sysctl -a | grep memory
```

**🔧 参数修改**
```bash
# 临时修改参数（重启后失效）
sysctl -w net.ipv4.ip_forward=1
sysctl -w vm.swappiness=10

# 永久修改（编辑配置文件）
echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf
sysctl -p  # 重新加载配置
```

**📋 常用系统参数**

| **参数名称** | **作用说明** | **常见取值** |
|-------------|-------------|-------------|
| `kernel.hostname` | 系统主机名 | 字符串 |
| `net.ipv4.ip_forward` | IP转发功能 | 0(关闭) / 1(开启) |
| `vm.swappiness` | swap使用倾向 | 0-100 |
| `kernel.pid_max` | 最大进程ID | 32768-4194304 |
| `fs.file-max` | 最大文件句柄数 | 数字 |

---

## 6. 🎯 运行级别管理


### 6.1 什么是运行级别


**🔸 运行级别概念**
运行级别就是Linux系统的不同"工作模式"。就像手机有飞行模式、省电模式一样，Linux系统也有不同的运行模式，每种模式启动的服务和功能不同。

**📊 运行级别对照表**
```
┌─────┬──────────────────────────────────┐
│级别 │              说明                │
├─────┼──────────────────────────────────┤
│  0  │ 关机模式 - 系统关闭              │
│  1  │ 单用户模式 - 系统维护模式        │
│  2  │ 多用户模式 - 无网络文件系统      │
│  3  │ 完整多用户模式 - 命令行界面      │
│  4  │ 用户自定义模式 - 通常未使用      │
│  5  │ 图形用户界面模式 - 桌面环境      │
│  6  │ 重启模式 - 系统重启              │
└─────┴──────────────────────────────────┘
```

### 6.2 查看当前运行级别


**🔧 runlevel命令**
```bash
# 查看当前运行级别
runlevel

# 输出示例: N 5
# N表示前一个级别(无)，5表示当前级别
```

**⚡ 其他查看方法**
```bash
# 使用who命令查看
who -r

# systemd系统中查看目标
systemctl get-default

# 查看当前target状态
systemctl list-units --type=target
```

### 6.3 运行级别切换


**🔄 传统方法**
```bash
# 切换到指定运行级别
init 0    # 关机
init 1    # 单用户模式
init 3    # 命令行模式  
init 5    # 图形界面模式
init 6    # 重启系统
```

**🆕 systemd方法**
```bash
# 切换到对应target
systemctl isolate poweroff.target     # 相当于init 0
systemctl isolate rescue.target       # 相当于init 1  
systemctl isolate multi-user.target   # 相当于init 3
systemctl isolate graphical.target    # 相当于init 5
systemctl isolate reboot.target       # 相当于init 6
```

### 6.4 设置默认运行级别


**⚙️ 永久设置**
```bash
# systemd系统设置默认启动模式
systemctl set-default multi-user.target   # 设置为命令行模式
systemctl set-default graphical.target    # 设置为图形界面模式

# 查看默认模式
systemctl get-default
```

> 💡 **实用提示**: 服务器通常设置为运行级别3(命令行)，桌面系统设置为运行级别5(图形界面)。

**🔄 运行级别与服务关系**
```
运行级别决定启动哪些服务：

级别3 (命令行):
├── 网络服务 ✓
├── SSH服务 ✓  
├── 数据库服务 ✓
└── 图形界面 ✗

级别5 (图形界面):
├── 网络服务 ✓
├── SSH服务 ✓
├── 数据库服务 ✓  
└── 图形界面 ✓
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本概念


```
🔸 systemctl: 现代Linux服务管理工具，用于查看和控制服务状态
🔸 service: 传统服务管理命令，简单易用但功能有限
🔸 单元(Unit): systemd管理的基本对象，包括服务、定时器等
🔸 chkconfig: 传统系统的开机自启动管理工具
🔸 /proc/sys: 系统内核参数存储目录，实时反映系统状态
🔸 sysctl: 系统参数查看和修改工具，比直接访问/proc/sys更友好
🔸 运行级别: Linux系统的不同工作模式，决定启动哪些服务
```

### 7.2 关键理解要点


**🔹 服务状态管理的演进**
```
传统方式 → 现代方式
service  → systemctl  
chkconfig → systemctl enable/disable
init级别 → systemd target
```

**🔹 系统参数的两种访问方式**
```
直接访问: cat /proc/sys/kernel/hostname
工具访问: sysctl kernel.hostname
区别: sysctl更友好，还能修改参数
```

**🔹 运行级别的实际意义**
```
不同运行级别 = 不同服务组合
服务器常用: 级别3 (命令行)  
桌面常用: 级别5 (图形界面)
特殊用途: 级别1 (维护模式)
```

### 7.3 实际应用指导


**🎯 日常运维场景**
- **服务故障排查**: `systemctl status 服务名` 查看详细状态信息
- **开机自启动管理**: `systemctl enable/disable` 控制服务自启动
- **系统性能调优**: 使用`sysctl`查看和修改内核参数
- **系统维护**: 切换到合适的运行级别进行维护工作

**⚡ 快速诊断流程**
```
1. systemctl status [服务] - 查看服务状态
2. systemctl list-units --failed - 查看失败服务
3. sysctl -a | grep [关键字] - 查看相关系统参数
4. runlevel - 确认当前运行级别
```

**🔧 常用命令速查**
```bash
# 服务状态相关
systemctl status ssh              # 查看SSH服务状态
systemctl list-units --failed     # 查看失败的服务
service --status-all              # 查看所有传统服务状态

# 系统参数相关  
sysctl -a                        # 查看所有系统参数
cat /proc/sys/kernel/hostname    # 查看主机名
sysctl kernel.version            # 查看内核版本

# 运行级别相关
runlevel                         # 查看当前运行级别
systemctl get-default            # 查看默认启动模式
```

**核心记忆**：
- systemctl管现代服务，service管传统服务
- /proc/sys存参数，sysctl更好用
- 运行级别定模式，3是命令行，5是图形界面
- 服务状态要常看，系统参数按需调