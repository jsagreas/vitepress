---
title: 8、网络连接状态查看
---
## 📚 目录

1. [ss套接字统计命令](#1-ss套接字统计命令)
2. [netstat网络连接查看](#2-netstat网络连接查看)
3. [lsof网络文件查看](#3-lsof网络文件查看)
4. [系统网络文件详解](#4-系统网络文件详解)
5. [iptables连接跟踪](#5-iptables连接跟踪)
6. [端口占用查看实战](#6-端口占用查看实战)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔍 ss套接字统计命令


### 1.1 ss命令简介


**🔸 什么是ss命令**
```
ss是Socket Statistics的缩写，意思是套接字统计
作用：查看系统中所有网络连接的状态信息
优势：比netstat更快，功能更强，是现代Linux的首选工具
```

**💡 为什么ss比netstat好用**
- **速度更快**：直接从内核获取信息，不需要遍历/proc文件系统
- **信息更全**：显示更详细的连接状态和统计信息
- **功能更强**：支持更多过滤条件和输出格式

### 1.2 基本语法和常用选项


**📋 基本语法**
```bash
ss [选项] [过滤条件]
```

| 选项 | **作用说明** | **使用场景** |
|------|-------------|-------------|
| `-t` | `显示TCP连接` | `查看TCP连接状态` |
| `-u` | `显示UDP连接` | `查看UDP通信情况` |
| `-l` | `只显示监听状态` | `查看开放的服务端口` |
| `-a` | `显示所有连接` | `全面查看网络状态` |
| `-n` | `以数字形式显示` | `避免域名解析，提高速度` |
| `-p` | `显示进程信息` | `查看端口被哪个程序占用` |

### 1.3 实用命令示例


**⭐ 查看所有TCP监听端口**
```bash
ss -tlnp
```

**输出解释**：
```
State    Recv-Q Send-Q Local Address:Port  Peer Address:Port Process
LISTEN   0      128    0.0.0.0:22         *:*           users:(("sshd",pid=1234,fd=3))
LISTEN   0      128    127.0.0.1:3306     *:*           users:(("mysqld",pid=5678,fd=4))
```

> 💡 **字段含义说明**：
> - **State**：连接状态（LISTEN表示监听状态）
> - **Recv-Q**：接收队列中等待处理的数据包数量
> - **Send-Q**：发送队列中等待发送的数据包数量
> - **Local Address:Port**：本地IP地址和端口
> - **Process**：占用端口的进程信息

**⭐ 查看所有TCP连接**
```bash
ss -tan
```

**⭐ 查看指定端口的连接**
```bash
ss -tlnp sport :80    # 查看80端口
ss -tlnp dport :3306  # 查看连接到3306端口的
```

### 1.4 高级过滤技巧


**🎯 按状态过滤**
```bash
ss state listening                    # 只看监听状态
ss state established                  # 只看已建立连接
ss state time-wait                    # 只看TIME_WAIT状态
```

**🎯 按端口范围过滤**
```bash
ss sport \> :1024                     # 源端口大于1024
ss dport \< :1024                     # 目标端口小于1024
ss sport :8080-8090                   # 端口范围8080-8090
```

---

## 2. 🌐 netstat网络连接查看


### 2.1 netstat命令概述


**🔸 netstat的作用**
```
netstat是Network Statistics的缩写，意思是网络统计
功能：显示网络连接、路由表、接口统计等网络相关信息
特点：历史悠久，兼容性好，但速度比ss慢
```

**⚠️ 注意事项**
> 现代Linux系统推荐使用ss命令，但netstat在某些老系统中仍然必需

### 2.2 常用选项组合


| 选项组合 | **含义** | **实际用途** |
|---------|---------|-------------|
| `-an` | `显示所有连接，数字格式` | `快速查看所有网络连接` |
| `-tlnp` | `TCP监听端口+进程` | `查看服务器开放的端口` |
| `-ulnp` | `UDP监听端口+进程` | `查看UDP服务` |
| `-r` | `显示路由表` | `查看网络路由信息` |
| `-i` | `显示网络接口` | `查看网卡状态统计` |

### 2.3 实用示例对比


**📊 netstat vs ss对比**

查看监听端口：
```bash
# netstat方式
netstat -tlnp | grep LISTEN

# ss方式（推荐）
ss -tlnp
```

查看端口占用：
```bash
# netstat方式
netstat -tlnp | grep :80

# ss方式（更快）
ss -tlnp sport :80
```

---

## 3. 📁 lsof网络文件查看


### 3.1 lsof命令理解


**🔸 什么是lsof**
```
lsof是List Open Files的缩写，意思是列出打开的文件
核心概念：在Linux中，一切皆文件，包括网络连接
网络连接本质：也是一种特殊的文件描述符
```

**💡 为什么lsof能查看网络连接**
- Linux把网络套接字当作特殊文件处理
- 每个网络连接都对应一个文件描述符
- lsof能列出进程打开的所有文件，包括网络文件

### 3.2 网络相关选项


**📋 网络查看选项**

| 选项 | **作用** | **使用场景** |
|------|---------|-------------|
| `-i` | `显示网络连接` | `查看所有网络文件` |
| `-i :端口` | `显示指定端口` | `查看某端口的占用情况` |
| `-i tcp` | `只显示TCP连接` | `专注TCP协议分析` |
| `-i udp` | `只显示UDP连接` | `专注UDP协议分析` |

### 3.3 实战命令示例


**⭐ 查看所有网络连接**
```bash
lsof -i
```

**输出示例**：
```
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
sshd    1234 root    3u  IPv4  12345      0t0  TCP *:ssh (LISTEN)
nginx   5678 www     6u  IPv4  67890      0t0  TCP *:http (LISTEN)
```

> 📝 **字段解释**：
> - **COMMAND**：进程名称
> - **PID**：进程ID
> - **USER**：运行用户
> - **FD**：文件描述符（数字+u表示读写模式）
> - **TYPE**：文件类型（IPv4/IPv6）
> - **NAME**：网络连接信息

**⭐ 查看特定端口占用**
```bash
lsof -i :80              # 查看80端口
lsof -i :3306            # 查看3306端口
lsof -i tcp:22           # 查看TCP 22端口
```

**⭐ 查看进程的所有网络连接**
```bash
lsof -i -p 1234          # 查看PID为1234的网络连接
lsof -i -c nginx         # 查看nginx进程的网络连接
```

---

## 4. 📂 系统网络文件详解


### 4.1 /proc/net目录概述


**🔸 什么是/proc/net目录**
```
/proc/net是Linux内核提供的虚拟文件系统
作用：实时反映当前系统的网络连接状态
特点：文件内容由内核动态生成，不占用实际磁盘空间
```

**📁 重要网络文件清单**
```
/proc/net/tcp     ← TCP连接信息
/proc/net/udp     ← UDP连接信息
/proc/net/tcp6    ← IPv6 TCP连接
/proc/net/udp6    ← IPv6 UDP连接
/proc/net/route   ← 路由表信息
/proc/net/arp     ← ARP表信息
```

### 4.2 TCP连接文件分析


**📊 /proc/net/tcp文件格式**
```bash
cat /proc/net/tcp
```

**输出示例**：
```
  sl  local_address rem_address   st tx_queue rx_queue tr tm->when retrnsmt   uid
   0: 00000000:0016 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0
   1: 0100007F:0CEA 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0
```

**🔍 字段含义解释**：

| 字段 | **含义** | **说明** |
|------|---------|----------|
| `sl` | `序号` | `连接的序列号` |
| `local_address` | `本地地址:端口` | `十六进制格式显示` |
| `rem_address` | `远程地址:端口` | `远程连接信息` |
| `st` | `连接状态` | `0A=LISTEN状态` |
| `tx_queue` | `发送队列` | `待发送数据量` |
| `rx_queue` | `接收队列` | `待处理数据量` |
| `uid` | `用户ID` | `连接所属用户` |

**💡 地址转换技巧**
```bash
# 十六进制 0100007F:0016 转换为可读格式
# 0100007F = 127.0.0.1 (小端字节序)
# 0016 = 22 (十六进制转十进制)
# 结果：127.0.0.1:22
```

### 4.3 UDP连接文件分析


**📊 /proc/net/udp文件特点**
```
UDP是无连接协议，所以文件内容主要显示监听端口
格式与TCP文件类似，但状态字段含义不同
```

**实际应用**：
```bash
# 查看UDP监听端口
awk '{print $2}' /proc/net/udp | grep -v local_address
```

---

## 5. 🔥 iptables连接跟踪


### 5.1 连接跟踪概念


**🔸 什么是连接跟踪**
```
连接跟踪（Connection Tracking）是Linux内核的一个功能模块
作用：跟踪网络连接的状态变化，记录连接的完整生命周期
原理：维护一个连接状态表，记录每个连接的详细信息
```

**🎯 连接跟踪的作用**
- **防火墙状态检测**：基于连接状态制定防火墙规则
- **NAT功能实现**：网络地址转换需要跟踪连接状态
- **网络监控分析**：了解网络流量和连接模式

### 5.2 conntrack工具使用


**📋 conntrack命令功能**
```bash
# 查看所有连接跟踪记录
conntrack -L

# 查看TCP连接
conntrack -L -p tcp

# 查看特定IP的连接
conntrack -L -s 192.168.1.100

# 实时监控新连接
conntrack -E
```

**⚠️ 安装提示**
> 如果系统没有conntrack命令，需要安装：
> ```bash
> # CentOS/RHEL
> yum install conntrack-tools
> 
> # Ubuntu/Debian  
> apt-get install conntrack
> ```

### 5.3 连接跟踪表查看


**📊 /proc/net/nf_conntrack文件**
```bash
cat /proc/net/nf_conntrack
```

**输出解释**：
```
tcp  6 299 ESTABLISHED src=192.168.1.10 dst=192.168.1.20 sport=52108 dport=80 
     src=192.168.1.20 dst=192.168.1.10 sport=80 dport=52108 [ASSURED] mark=0
```

> 💡 **字段含义**：
> - **协议类型**：tcp（协议），6（协议号）
> - **TTL**：299（连接剩余生存时间，秒）
> - **状态**：ESTABLISHED（已建立连接）
> - **方向1**：src到dst的数据流信息
> - **方向2**：响应方向的数据流信息
> - **[ASSURED]**：连接已确认建立

---

## 6. 🎯 端口占用查看实战


### 6.1 端口占用排查流程


**📋 标准排查步骤**
```
① 确定端口是否被占用
② 找出占用端口的进程
③ 确认进程是否正常
④ 决定是否需要释放端口
```

### 6.2 多种方法对比


**⭐ 方法一：使用ss命令（推荐）**
```bash
# 查看8080端口占用情况
ss -tlnp | grep :8080

# 如果有输出，说明端口被占用
# 输出格式：LISTEN 0 128 *:8080 *:* users:(("java",pid=12345,fd=52))
```

**⭐ 方法二：使用lsof命令**
```bash
lsof -i :8080

# 输出会显示占用进程的详细信息
# java    12345   user   52u  IPv6  123456      0t0  TCP *:8080 (LISTEN)
```

**⭐ 方法三：使用netstat命令**
```bash
netstat -tlnp | grep :8080

# 传统方法，速度较慢但兼容性好
```

### 6.3 常见端口问题处理


**🔸 端口被占用的处理方式**

**情况1：正常进程占用**
```bash
# 1. 确认进程PID
lsof -i :8080

# 2. 查看进程详情
ps -ef | grep 12345

# 3. 如果需要释放端口，优雅停止进程
kill -15 12345    # 发送TERM信号，优雅停止
```

**情况2：僵尸进程占用**
```bash
# 1. 强制杀死进程
kill -9 12345

# 2. 确认端口是否释放
ss -tlnp | grep :8080
```

**🔧 端口释放验证**
```bash
# 检查端口是否可用
telnet localhost 8080    # 如果连接失败，说明端口已释放
# 或者
nc -zv localhost 8080    # 使用nc命令检测
```

### 6.4 批量端口检查脚本


**📝 实用脚本示例**
```bash
#!/bin/bash
# 检查常见服务端口的占用情况

ports=(22 80 443 3306 6379 8080)

for port in "${ports[@]}"; do
    if ss -tlnp | grep -q ":$port "; then
        echo "端口 $port 已被占用："
        ss -tlnp | grep ":$port "
    else
        echo "端口 $port 可用"
    fi
    echo "---"
done
```

---

## 7. 📋 核心要点总结


### 7.1 命令选择指南


**🎯 不同场景的命令选择**

| 使用场景 | **推荐命令** | **原因** |
|---------|-------------|----------|
| `日常监控` | `ss -tlnp` | `速度快，信息全` |
| `端口排查` | `lsof -i :端口` | `进程信息详细` |
| `兼容老系统` | `netstat -tlnp` | `通用性好` |
| `深度分析` | `查看/proc/net文件` | `原始数据，可定制处理` |
| `连接追踪` | `conntrack -L` | `状态信息完整` |

### 7.2 常用命令速记


**⚡ 高频使用命令**
```bash
# 查看所有TCP监听端口
ss -tlnp

# 查看指定端口占用
lsof -i :端口号

# 查看所有网络连接
ss -tan

# 实时监控网络连接变化
ss -t state all
```

### 7.3 实战技巧总结


**💡 效率提升技巧**
- ✅ **优先使用ss**：比netstat快10倍以上
- ✅ **善用过滤条件**：避免信息过载，精确定位
- ✅ **结合多工具**：不同工具互相验证，确保准确性
- ✅ **了解输出格式**：熟悉字段含义，快速获取关键信息

**🚨 注意事项**
- ⚠️ **权限要求**：查看进程信息需要相应权限
- ⚠️ **性能影响**：频繁查询大量连接可能影响系统性能
- ⚠️ **版本差异**：不同Linux发行版命令选项可能略有不同

### 7.4 故障排查思路


**🔍 网络问题排查流程**
```
① 确认服务是否启动 → ps aux | grep 服务名
② 检查端口是否监听 → ss -tlnp | grep :端口
③ 确认防火墙状态 → iptables -L 或 firewall-cmd --list-all
④ 测试端口连通性 → telnet IP 端口
⑤ 查看连接状态 → ss state established
```

**核心记忆要点**：
- **ss命令现代首选**：速度快功能强，替代netstat
- **lsof专查进程**：端口占用问题必备工具  
- **proc文件系统**：深入了解网络状态的底层数据
- **多工具组合**：不同场景选择合适工具，提高效率