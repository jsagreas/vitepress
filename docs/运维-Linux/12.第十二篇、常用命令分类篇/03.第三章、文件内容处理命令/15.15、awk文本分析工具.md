---
title: 15ã€awkæ–‡æœ¬åˆ†æå·¥å…·
---
## ğŸ“š ç›®å½•

1. [awkåŸºç¡€æ¦‚å¿µä¸å·¥ä½œåŸç†](#1-awkåŸºç¡€æ¦‚å¿µä¸å·¥ä½œåŸç†)
2. [awkç¨‹åºç»“æ„æ¨¡å¼](#2-awkç¨‹åºç»“æ„æ¨¡å¼)
3. [å­—æ®µå˜é‡ä¸å†…ç½®å˜é‡è¯¦è§£](#3-å­—æ®µå˜é‡ä¸å†…ç½®å˜é‡è¯¦è§£)
4. [æ¡ä»¶åˆ¤æ–­ä¸å¾ªç¯æ§åˆ¶](#4-æ¡ä»¶åˆ¤æ–­ä¸å¾ªç¯æ§åˆ¶)
5. [æ•°å­¦è¿ç®—ä¸å†…ç½®å‡½æ•°](#5-æ•°å­¦è¿ç®—ä¸å†…ç½®å‡½æ•°)
6. [æ ¼å¼åŒ–è¾“å‡ºæ§åˆ¶](#6-æ ¼å¼åŒ–è¾“å‡ºæ§åˆ¶)
7. [å¤šæ–‡ä»¶å¤„ç†æŠ€å·§](#7-å¤šæ–‡ä»¶å¤„ç†æŠ€å·§)
8. [æŠ¥è¡¨ç”Ÿæˆä¸æ•°æ®åˆ†æå®æˆ˜](#8-æŠ¥è¡¨ç”Ÿæˆä¸æ•°æ®åˆ†æå®æˆ˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ awkåŸºç¡€æ¦‚å¿µä¸å·¥ä½œåŸç†


### 1.1 ä»€ä¹ˆæ˜¯awk

**awk**æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ï¼Œä¸“é—¨ç”¨æ¥åˆ†æå’Œå¤„ç†**ç»“æ„åŒ–æ–‡æœ¬**ï¼Œå°±åƒExcelå¤„ç†è¡¨æ ¼æ•°æ®ä¸€æ ·ã€‚

> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> awkæŠŠæ¯ä¸€è¡Œå½“ä½œä¸€æ¡è®°å½•ï¼ŒæŠŠæ¯è¡Œä¸­ç”¨ç©ºæ ¼ï¼ˆæˆ–æŒ‡å®šåˆ†éš”ç¬¦ï¼‰åˆ†å¼€çš„éƒ¨åˆ†å½“ä½œå­—æ®µï¼Œç„¶åå¯ä»¥å¯¹è¿™äº›å­—æ®µè¿›è¡Œå„ç§æ“ä½œ

**ğŸ”¸ awké€‚åˆå¤„ç†çš„æ•°æ®ï¼š**
```
æ—¥å¿—æ–‡ä»¶ï¼š   è®¿é—®æ—¶é—´  IPåœ°å€      çŠ¶æ€ç   å“åº”å¤§å°
            10:30:45  192.168.1.1  200    1024
            10:30:46  192.168.1.2  404    512

CSVæ–‡ä»¶ï¼š   å§“å,å¹´é¾„,åŸå¸‚,è–ªèµ„
           å¼ ä¸‰,25,åŒ—äº¬,8000
           æå››,30,ä¸Šæµ·,9000

é…ç½®æ–‡ä»¶ï¼š  user1:x:1001:1001:User One:/home/user1:/bin/bash
```

### 1.2 awkå·¥ä½œåŸç†

```
awkå·¥ä½œæµç¨‹ï¼š
è¾“å…¥æ–‡ä»¶ â†’ é€è¡Œè¯»å– â†’ æŒ‰åˆ†éš”ç¬¦åˆ‡åˆ†å­—æ®µ â†’ æ‰§è¡Œawkç¨‹åº â†’ è¾“å‡ºç»“æœ

å¤„ç†è¿‡ç¨‹å›¾ç¤ºï¼š
è¡Œ1: "å¼ ä¸‰ 25 åŒ—äº¬" â†’ $1="å¼ ä¸‰" $2="25" $3="åŒ—äº¬" â†’ å¤„ç† â†’ è¾“å‡º
è¡Œ2: "æå›› 30 ä¸Šæµ·" â†’ $1="æå››" $2="30" $3="ä¸Šæµ·" â†’ å¤„ç† â†’ è¾“å‡º
è¡Œ3: "ç‹äº” 35 æ·±åœ³" â†’ $1="ç‹äº”" $2="35" $3="æ·±åœ³" â†’ å¤„ç† â†’ è¾“å‡º
```

### 1.3 åŸºæœ¬ä½¿ç”¨è¯­æ³•

```bash
# åŸºæœ¬è¯­æ³•æ ¼å¼
awk 'program' file
awk 'program' file1 file2 ...
awk -f script.awk file

# programçš„åŸºæœ¬ç»“æ„
awk 'BEGIN{...} pattern{action} END{...}' file
```

**ğŸ“ ç®€å•ç¤ºä¾‹ï¼š**
```bash
# æ‰“å°æ–‡ä»¶æ¯è¡Œçš„ç¬¬ä¸€ä¸ªå­—æ®µ
awk '{print $1}' /etc/passwd

# æ‰“å°åŒ…å«"root"çš„è¡Œ
awk '/root/{print}' /etc/passwd
```

---

## 2. ğŸ—ï¸ awkç¨‹åºç»“æ„æ¨¡å¼


### 2.1 ä¸‰æ®µå¼ç¨‹åºç»“æ„


**awkç¨‹åº**ç”±ä¸‰ä¸ªå¯é€‰éƒ¨åˆ†ç»„æˆï¼Œå°±åƒä¸€ä¸ªå®Œæ•´çš„å¤„ç†æµæ°´çº¿ï¼š

```
BEGINå—ï¼šå¼€å§‹å¤„ç†å‰æ‰§è¡Œï¼ˆåˆå§‹åŒ–ï¼‰
ä¸»å¤„ç†å—ï¼šå¯¹æ¯ä¸€è¡Œæ‰§è¡Œçš„æ“ä½œ
ENDå—ï¼šå¤„ç†å®Œæ‰€æœ‰è¡Œåæ‰§è¡Œï¼ˆæ€»ç»“ï¼‰
```

**ğŸ”§ ç»“æ„æ¨¡æ¿ï¼š**
```bash
awk '
BEGIN {
    # åˆå§‹åŒ–æ“ä½œï¼šè®¾ç½®å˜é‡ã€æ‰“å°æ ‡é¢˜ç­‰
    print "å¼€å§‹å¤„ç†æ•°æ®..."
    total = 0
}

# ä¸»å¤„ç†å—ï¼šå¯¹æ¯è¡Œæ‰§è¡Œ
{
    # å¤„ç†æ¯ä¸€è¡Œçš„ä»£ç 
    total += $2
    print $1, $2
}

END {
    # ç»“æŸæ“ä½œï¼šç»Ÿè®¡ã€æ±‡æ€»ç­‰
    print "å¤„ç†å®Œæˆï¼Œæ€»è®¡:", total
}' data.txt
```

### 2.2 æ¨¡å¼åŒ¹é…ç±»å‹


**ğŸ”¸ è¡ŒåŒ¹é…æ¨¡å¼ï¼š**

| æ¨¡å¼ç±»å‹ | **è¯­æ³•** | **å«ä¹‰** | **ç¤ºä¾‹** |
|---------|---------|----------|-----------|
| **æ­£åˆ™è¡¨è¾¾å¼** | `/pattern/` | åŒ¹é…åŒ…å«æ¨¡å¼çš„è¡Œ | `/error/{print}` |
| **è¡¨è¾¾å¼åŒ¹é…** | `expression` | è¡¨è¾¾å¼ä¸ºçœŸçš„è¡Œ | `$3 > 100` |
| **èŒƒå›´åŒ¹é…** | `/start/,/end/` | ä»startåˆ°endçš„è¡Œ | `/BEGIN/,/END/` |
| **è¡Œå·åŒ¹é…** | `NR==n` | ç¬¬nè¡Œ | `NR==1` |
| **å­—æ®µåŒ¹é…** | `$n ~ /pattern/` | ç¬¬nå­—æ®µåŒ¹é… | `$1 ~ /^root/` |

**ğŸ“‹ å®ä¾‹æ¼”ç¤ºï¼š**
```bash
# å¤„ç†Apacheæ—¥å¿—æ–‡ä»¶
awk '
BEGIN { 
    print "ç½‘ç«™è®¿é—®ç»Ÿè®¡æŠ¥å‘Š"
    print "==================="
    error_count = 0
    total_count = 0
}

# ç»Ÿè®¡æ‰€æœ‰è®¿é—®
{
    total_count++
}

# ç»Ÿè®¡é”™è¯¯ï¼ˆçŠ¶æ€ç 4xxæˆ–5xxï¼‰
$9 ~ /^[45]/ {
    error_count++
    print "é”™è¯¯è®¿é—®:", $1, $7, $9
}

END {
    print "æ€»è®¿é—®æ•°:", total_count
    print "é”™è¯¯æ•°:", error_count
    printf "é”™è¯¯ç‡: %.2f%%\n", (error_count/total_count)*100
}' access.log
```

### 2.3 å¤šæ¨¡å¼ç»„åˆ

```bash
# å¤æ‚çš„å¤šæ¡ä»¶å¤„ç†
awk '
# è·³è¿‡æ³¨é‡Šè¡Œå’Œç©ºè¡Œ
/^#/ || /^$/ { next }

# å¤„ç†ç”¨æˆ·ä¿¡æ¯è¡Œ
/^user/ {
    user_count++
    print "å‘ç°ç”¨æˆ·:", $2
}

# å¤„ç†ç³»ç»Ÿé…ç½®è¡Œ
$1 == "config" && $3 > 100 {
    print "é‡è¦é…ç½®:", $0
}' system.conf
```

---

## 3. ğŸ¯ å­—æ®µå˜é‡ä¸å†…ç½®å˜é‡è¯¦è§£


### 3.1 å­—æ®µå˜é‡ç³»ç»Ÿ


**å­—æ®µå˜é‡**å°±æ˜¯awkè‡ªåŠ¨æŠŠæ¯è¡Œæ–‡æœ¬æŒ‰åˆ†éš”ç¬¦åˆ‡åˆ†åçš„å„ä¸ªéƒ¨åˆ†ï¼š

```
è¾“å…¥è¡Œ: "å¼ ä¸‰ 25 åŒ—äº¬ å·¥ç¨‹å¸ˆ"
åˆ†éš”ç»“æœ:
$0 = "å¼ ä¸‰ 25 åŒ—äº¬ å·¥ç¨‹å¸ˆ"  (æ•´è¡Œ)
$1 = "å¼ ä¸‰"                (ç¬¬1å­—æ®µ)
$2 = "25"                  (ç¬¬2å­—æ®µ) 
$3 = "åŒ—äº¬"                (ç¬¬3å­—æ®µ)
$4 = "å·¥ç¨‹å¸ˆ"              (ç¬¬4å­—æ®µ)
```

**ğŸ”¸ å­—æ®µæ“ä½œæŠ€å·§ï¼š**
```bash
# æ‰“å°æŒ‡å®šå­—æ®µ
awk '{print $1, $3}' data.txt

# æ‰“å°æœ€åä¸€ä¸ªå­—æ®µ
awk '{print $NF}' data.txt

# æ‰“å°å€’æ•°ç¬¬äºŒä¸ªå­—æ®µ
awk '{print $(NF-1)}' data.txt

# ä¿®æ”¹å­—æ®µå€¼
awk '{$2 = $2 * 1.1; print}' prices.txt
```

### 3.2 æ ¸å¿ƒå†…ç½®å˜é‡


**ğŸ“Š é‡è¦å†…ç½®å˜é‡è¡¨ï¼š**

| å˜é‡ | **å«ä¹‰** | **ç¤ºä¾‹å€¼** | **å¸¸ç”¨åœºæ™¯** |
|------|----------|------------|-------------|
| `NR` | å½“å‰è®°å½•å·ï¼ˆè¡Œå·ï¼‰ | `15` | æ‰“å°è¡Œå·ã€æ¡ä»¶åˆ¤æ–­ |
| `NF` | å½“å‰è®°å½•å­—æ®µæ•° | `4` | æ£€æŸ¥æ•°æ®æ ¼å¼ã€è®¿é—®æœ€åå­—æ®µ |
| `FS` | å­—æ®µåˆ†éš”ç¬¦ | `" "` | æŒ‡å®šåˆ†éš”ç¬¦ |
| `RS` | è®°å½•åˆ†éš”ç¬¦ | `"\n"` | å¤šè¡Œè®°å½•å¤„ç† |
| `OFS` | è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ | `" "` | æ ¼å¼åŒ–è¾“å‡º |
| `ORS` | è¾“å‡ºè®°å½•åˆ†éš”ç¬¦ | `"\n"` | æ§åˆ¶æ¢è¡Œ |
| `FILENAME` | å½“å‰æ–‡ä»¶å | `data.txt` | å¤šæ–‡ä»¶å¤„ç† |

**ğŸ”§ å˜é‡ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# è®¾ç½®ä¸åŒçš„åˆ†éš”ç¬¦å¤„ç†CSV
awk 'BEGIN{FS=","} {print $1, $3}' data.csv

# æ·»åŠ è¡Œå·
awk '{print NR ": " $0}' file.txt

# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
awk 'NF != 4 {print "è¡Œ" NR "æ•°æ®ä¸å®Œæ•´:", $0}' data.txt

# ç»Ÿè®¡æ¯ä¸ªæ–‡ä»¶çš„è¡Œæ•°
awk '{lines[FILENAME]++} END {
    for (f in lines) 
        print f, lines[f] "è¡Œ"
}' *.txt
```

### 3.3 è‡ªå®šä¹‰å˜é‡

```bash
# å˜é‡æ— éœ€å£°æ˜ï¼Œç›´æ¥ä½¿ç”¨
awk '
BEGIN { sum = 0; count = 0 }
{
    sum += $2
    count++
}
END { 
    average = sum / count
    print "å¹³å‡å€¼:", average 
}' numbers.txt

# æ•°ç»„å˜é‡çš„ä½¿ç”¨
awk '{
    city[$3]++  # ç»Ÿè®¡æ¯ä¸ªåŸå¸‚çš„äººæ•°
}
END {
    for (c in city)
        print c, city[c] "äºº"
}' personnel.txt
```

---

## 4. ğŸ”„ æ¡ä»¶åˆ¤æ–­ä¸å¾ªç¯æ§åˆ¶


### 4.1 æ¡ä»¶åˆ¤æ–­è¯­å¥


**awkä¸­çš„æ¡ä»¶åˆ¤æ–­**å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ç±»ä¼¼ï¼Œä½†æ›´é€‚åˆæ–‡æœ¬å¤„ç†ï¼š

**ğŸ”¸ ifè¯­å¥ç»“æ„ï¼š**
```bash
# å•æ¡ä»¶åˆ¤æ–­
awk '{
    if ($2 > 30) 
        print $1 "å¹´é¾„å¤§äº30"
    else 
        print $1 "å¹´é¾„ä¸å¤§äº30"
}' people.txt

# å¤šæ¡ä»¶åˆ¤æ–­
awk '{
    if ($2 >= 60)
        grade = "ä¼˜ç§€"
    else if ($2 >= 80)
        grade = "è‰¯å¥½"
    else if ($2 >= 60)
        grade = "åŠæ ¼"
    else
        grade = "ä¸åŠæ ¼"
    print $1, grade
}' scores.txt
```

**ğŸ”¸ æ¯”è¾ƒæ“ä½œç¬¦ï¼š**

| æ“ä½œç¬¦ | **å«ä¹‰** | **ç¤ºä¾‹** | **è¯´æ˜** |
|-------|----------|----------|----------|
| `==` | ç­‰äº | `$1 == "root"` | å­—ç¬¦ä¸²æ¯”è¾ƒ |
| `!=` | ä¸ç­‰äº | `$2 != 0` | æ•°å€¼/å­—ç¬¦ä¸² |
| `>` `<` | å¤§äºå°äº | `$3 > 100` | æ•°å€¼æ¯”è¾ƒ |
| `>=` `<=` | å¤§äºç­‰äº | `$2 >= 18` | æ•°å€¼æ¯”è¾ƒ |
| `~` | åŒ¹é…æ­£åˆ™ | `$1 ~ /^[Aa]/` | æ¨¡å¼åŒ¹é… |
| `!~` | ä¸åŒ¹é… | `$1 !~ /test/` | åå‘åŒ¹é… |

### 4.2 å¾ªç¯è¯­å¥


**ğŸ”„ forå¾ªç¯åº”ç”¨ï¼š**
```bash
# éå†æ•°ç»„
awk '{
    for (i in word_count)
        print i, word_count[i]
}'

# æ•°å€¼å¾ªç¯
awk 'BEGIN {
    for (i=1; i<=10; i++)
        print "æ•°å­—:", i
}'

# å¤„ç†æ¯è¡Œçš„æ‰€æœ‰å­—æ®µ
awk '{
    for (i=1; i<=NF; i++) {
        if ($i ~ /error/)
            error_fields++
    }
}' log.txt
```

**ğŸ”„ whileå¾ªç¯ï¼š**
```bash
# whileå¾ªç¯ç¤ºä¾‹
awk '{
    i = 1
    while (i <= NF) {
        if ($i > max)
            max = $i
        i++
    }
}' numbers.txt
```

### 4.3 æµç¨‹æ§åˆ¶

```bash
# nextè·³è¿‡å½“å‰è¡Œ
awk '/^#/ {next} {print NR, $0}' config.txt

# breakå’Œcontinue
awk '{
    for (i=1; i<=NF; i++) {
        if ($i == "")
            continue
        if ($i == "END")
            break
        print $i
    }
}' data.txt
```

---

## 5. ğŸ§® æ•°å­¦è¿ç®—ä¸å†…ç½®å‡½æ•°


### 5.1 æ•°å­¦è¿ç®—ç¬¦


**awkæ”¯æŒå®Œæ•´çš„æ•°å­¦è¿ç®—**ï¼Œå¯ä»¥ç›´æ¥å¯¹å­—æ®µè¿›è¡Œè®¡ç®—ï¼š

**ğŸ”¸ åŸºæœ¬è¿ç®—ç¬¦ï¼š**
```
ç®—æœ¯è¿ç®—ï¼š +  -  *  /  %  ^(å¹‚)
èµ‹å€¼è¿ç®—ï¼š =  +=  -=  *=  /=  %=
æ¯”è¾ƒè¿ç®—ï¼š ==  !=  >  <  >=  <=
é€»è¾‘è¿ç®—ï¼š &&  ||  !
```

**ğŸ“Š è®¡ç®—ç¤ºä¾‹ï¼š**
```bash
# è®¡ç®—æ€»ä»·ï¼ˆå•ä»· * æ•°é‡ï¼‰
awk '{total = $2 * $3; print $1, total}' products.txt

# è®¡ç®—å¢é•¿ç‡
awk '{
    if (NR > 1) {
        growth = (($2 - prev) / prev) * 100
        printf "%s: %.2f%%\n", $1, growth
    }
    prev = $2
}' monthly_sales.txt

# ç´¯åŠ ç»Ÿè®¡
awk '{
    sum += $2
    count++
    avg = sum / count
    print $1, $2, "ç´¯ç§¯å¹³å‡:", avg
}' data.txt
```

### 5.2 æ•°å­¦å‡½æ•°


**ğŸ“ å†…ç½®æ•°å­¦å‡½æ•°ï¼š**

| å‡½æ•° | **åŠŸèƒ½** | **ç¤ºä¾‹** | **è¿”å›å€¼** |
|------|----------|----------|-----------|
| `int(x)` | å–æ•´æ•°éƒ¨åˆ† | `int(3.14)` | `3` |
| `sqrt(x)` | å¹³æ–¹æ ¹ | `sqrt(16)` | `4` |
| `exp(x)` | eçš„xæ¬¡æ–¹ | `exp(1)` | `2.71828` |
| `log(x)` | è‡ªç„¶å¯¹æ•° | `log(10)` | `2.30259` |
| `sin(x)` | æ­£å¼¦å€¼ | `sin(3.14/2)` | `1` |
| `cos(x)` | ä½™å¼¦å€¼ | `cos(0)` | `1` |
| `rand()` | 0-1éšæœºæ•° | `rand()` | `0.234` |
| `srand(x)` | è®¾ç½®éšæœºç§å­ | `srand(123)` | - |

**ğŸ”§ å‡½æ•°åº”ç”¨å®ä¾‹ï¼š**
```bash
# è®¡ç®—æ ‡å‡†å·®
awk '{
    data[NR] = $1
    sum += $1
    count++
}
END {
    avg = sum / count
    for (i in data) {
        variance += (data[i] - avg)^2
    }
    std_dev = sqrt(variance / count)
    printf "å¹³å‡å€¼: %.2f, æ ‡å‡†å·®: %.2f\n", avg, std_dev
}' numbers.txt

# ç”ŸæˆéšæœºæŠ½æ ·
awk 'BEGIN{srand()} rand() < 0.1 {print}' large_data.txt
```

### 5.3 å­—ç¬¦ä¸²å‡½æ•°


**ğŸ“ å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼š**

| å‡½æ•° | **åŠŸèƒ½** | **ç¤ºä¾‹** | **ç»“æœ** |
|------|----------|----------|----------|
| `length(s)` | å­—ç¬¦ä¸²é•¿åº¦ | `length("hello")` | `5` |
| `substr(s,start,len)` | æˆªå–å­ä¸² | `substr("hello",2,3)` | `"ell"` |
| `toupper(s)` | è½¬å¤§å†™ | `toupper("abc")` | `"ABC"` |
| `tolower(s)` | è½¬å°å†™ | `tolower("ABC")` | `"abc"` |
| `gsub(pattern,replacement,target)` | å…¨å±€æ›¿æ¢ | `gsub(/a/,"X",$0)` | æ›¿æ¢æ‰€æœ‰aä¸ºX |
| `sub(pattern,replacement,target)` | é¦–æ¬¡æ›¿æ¢ | `sub(/a/,"X",$0)` | æ›¿æ¢ç¬¬ä¸€ä¸ªa |

**ğŸ“‹ å­—ç¬¦ä¸²å¤„ç†ç¤ºä¾‹ï¼š**
```bash
# æ•°æ®æ¸…æ´—ï¼šå»é™¤å¤šä½™ç©ºæ ¼ï¼Œæ ‡å‡†åŒ–æ ¼å¼
awk '{
    gsub(/  +/, " ", $0)  # å¤šä¸ªç©ºæ ¼æ›¿æ¢ä¸ºå•ä¸ª
    $0 = toupper($0)      # è½¬ä¸ºå¤§å†™
    print length($0), $0  # è¾“å‡ºé•¿åº¦å’Œå†…å®¹
}' messy_data.txt

# æå–æ–‡ä»¶æ‰©å±•å
awk '{
    if (match($0, /\.[^.]+$/)) {
        ext = substr($0, RSTART+1, RLENGTH-1)
        files[ext]++
    }
}
END {
    for (e in files)
        print e, files[e]
}' file_list.txt
```

---

## 6. ğŸ¨ æ ¼å¼åŒ–è¾“å‡ºæ§åˆ¶


### 6.1 printä¸printfçš„åŒºåˆ«


**printè¯­å¥**ï¼šç®€å•è¾“å‡ºï¼Œè‡ªåŠ¨æ¢è¡Œ
**printfè¯­å¥**ï¼šæ ¼å¼åŒ–è¾“å‡ºï¼Œç±»ä¼¼Cè¯­è¨€çš„printf

> **ğŸ’¡ é€‰æ‹©å»ºè®®**
> ç®€å•è¾“å‡ºç”¨printï¼Œéœ€è¦ç²¾ç¡®æ ¼å¼æ§åˆ¶ç”¨printf

**ğŸ”¸ åŸºæœ¬å¯¹æ¯”ï¼š**
```bash
# printï¼šç®€å•ç›´æ¥
awk '{print $1, $2}' data.txt
# è¾“å‡ºï¼šå¼ ä¸‰ 25

# printfï¼šç²¾ç¡®æ§åˆ¶
awk '{printf "%sçš„å¹´é¾„æ˜¯%då²\n", $1, $2}' data.txt  
# è¾“å‡ºï¼šå¼ ä¸‰çš„å¹´é¾„æ˜¯25å²
```

### 6.2 printfæ ¼å¼æ§åˆ¶


**ğŸ“Š æ ¼å¼è¯´æ˜ç¬¦ï¼š**

| æ ¼å¼ç¬¦ | **ç±»å‹** | **ç¤ºä¾‹** | **è¾“å‡ºæ•ˆæœ** |
|--------|----------|----------|-------------|
| `%s` | å­—ç¬¦ä¸² | `printf "%s", $1` | åŸæ ·è¾“å‡ºå­—ç¬¦ä¸² |
| `%d` | æ•´æ•° | `printf "%d", $2` | æ•´æ•°æ ¼å¼ |
| `%f` | æµ®ç‚¹æ•° | `printf "%.2f", $3` | ä¿ç•™2ä½å°æ•° |
| `%e` | ç§‘å­¦è®¡æ•°æ³• | `printf "%e", $3` | 1.23e+02 |
| `%x` | åå…­è¿›åˆ¶ | `printf "%x", 255` | ff |
| `%c` | å­—ç¬¦ | `printf "%c", 65` | A |

**ğŸ”§ å®½åº¦å’Œç²¾åº¦æ§åˆ¶ï¼š**
```bash
# æ§åˆ¶è¾“å‡ºå®½åº¦å’Œå¯¹é½
awk '{
    printf "%-10s %8.2f %6d\n", $1, $2, $3
}' data.txt
# %-10s: å·¦å¯¹é½ï¼Œå 10å­—ç¬¦å®½åº¦
# %8.2f: å³å¯¹é½ï¼Œæ€»å®½8ä½ï¼Œå°æ•°2ä½  
# %6d: å³å¯¹é½ï¼Œå 6å­—ç¬¦å®½åº¦
```

### 6.3 å®ç”¨æ ¼å¼åŒ–ç¤ºä¾‹


**ğŸ“‹ åˆ¶ä½œå¯¹é½çš„æŠ¥è¡¨ï¼š**
```bash
# å‘˜å·¥è–ªèµ„æŠ¥è¡¨
awk 'BEGIN {
    printf "%-10s %8s %10s %12s\n", "å§“å", "éƒ¨é—¨", "åŸºæœ¬å·¥èµ„", "å®å‘å·¥èµ„"
    printf "%s\n", "============================================"
}
{
    actual = $3 * 0.8  # æ‰£é™¤20%ç¨è´¹
    printf "%-10s %8s %10.0f %12.2f\n", $1, $2, $3, actual
    total += actual
}
END {
    printf "%s\n", "============================================"
    printf "%-29s %12.2f\n", "æ€»è®¡:", total
}' salary.txt
```

**ğŸ¯ æ•°æ®ç»Ÿè®¡è¡¨æ ¼ï¼š**
```bash
# ç½‘ç«™è®¿é—®ç»Ÿè®¡
awk '{
    hour = substr($4, 13, 2)  # æå–å°æ—¶
    requests[hour]++
}
END {
    printf "\nå°æ—¶è®¿é—®ç»Ÿè®¡\n"
    printf "================\n"
    for (h=0; h<24; h++) {
        printf "%02d:00 ", h
        count = requests[sprintf("%02d", h)]
        # ç»˜åˆ¶ç®€å•æ¡å½¢å›¾
        for (i=1; i<=count/100; i++) printf "*"
        printf " (%d)\n", count
    }
}' access.log
```

---

## 7. ğŸ“ å¤šæ–‡ä»¶å¤„ç†æŠ€å·§


### 7.1 å¤„ç†å¤šä¸ªè¾“å…¥æ–‡ä»¶


**awkå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªæ–‡ä»¶**ï¼Œè¿™åœ¨æ•°æ®å¯¹æ¯”å’Œæ±‡æ€»æ—¶éå¸¸æœ‰ç”¨ï¼š

**ğŸ”¸ åŸºæœ¬å¤šæ–‡ä»¶å¤„ç†ï¼š**
```bash
# å¤„ç†å¤šä¸ªæ–‡ä»¶ï¼Œæ˜¾ç¤ºæ–‡ä»¶å
awk '{print FILENAME ": " $0}' file1.txt file2.txt file3.txt

# ç»Ÿè®¡æ¯ä¸ªæ–‡ä»¶çš„è¡Œæ•°
awk '{lines[FILENAME]++} 
END {
    for (file in lines)
        print file, lines[file]
}' *.txt
```

### 7.2 æ–‡ä»¶é—´æ•°æ®å…³è”


**ğŸ“Š å…³è”ä¸åŒæ–‡ä»¶çš„æ•°æ®ï¼š**
```bash
# å‘˜å·¥ä¿¡æ¯å…³è”ç¤ºä¾‹
# employees.txt: å·¥å· å§“å éƒ¨é—¨
# salaries.txt: å·¥å· è–ªèµ„

awk '
# ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼šå»ºç«‹å‘˜å·¥ä¿¡æ¯ç´¢å¼•
FNR==NR && FILENAME=="employees.txt" {
    name[$1] = $2
    dept[$1] = $3
    next
}

# ç¬¬äºŒä¸ªæ–‡ä»¶ï¼šæŸ¥æ‰¾å¯¹åº”ä¿¡æ¯å¹¶è¾“å‡º
FILENAME=="salaries.txt" {
    if ($1 in name) {
        printf "%-10s %-8s %8.0f\n", name[$1], dept[$1], $2
    }
}' employees.txt salaries.txt
```

**ğŸ”§ FNRä¸NRçš„åŒºåˆ«ï¼š**
```
NRï¼šå…¨å±€è¡Œå·ï¼ˆæ‰€æœ‰æ–‡ä»¶ç´¯åŠ ï¼‰
FNRï¼šå½“å‰æ–‡ä»¶è¡Œå·ï¼ˆæ¯ä¸ªæ–‡ä»¶é‡æ–°å¼€å§‹ï¼‰

ä½¿ç”¨æŠ€å·§ï¼š
FNR==NR  â†’  å¤„ç†ç¬¬ä¸€ä¸ªæ–‡ä»¶
FNR!=NR  â†’  å¤„ç†åç»­æ–‡ä»¶
```

### 7.3 æ•°æ®åˆå¹¶ä¸å¯¹æ¯”


**ğŸ“‹ æ–‡ä»¶å¯¹æ¯”ç¤ºä¾‹ï¼š**
```bash
# å¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶çš„å·®å¼‚
awk '
FNR==NR {
    file1[$0] = 1
    next
}
{
    if ($0 in file1)
        print "å…±åŒè¡Œ:", $0
    else
        print "ä»…åœ¨file2:", $0
}' file1.txt file2.txt

# å¤šæ–‡ä»¶æ•°æ®æ±‡æ€»
awk '{
    total += $2
    file_total[FILENAME] += $2
}
END {
    print "å„æ–‡ä»¶å°è®¡:"
    for (f in file_total)
        printf "  %s: %.2f\n", f, file_total[f]
    printf "æ€»è®¡: %.2f\n", total
}' sales_*.txt
```

---

## 8. ğŸ“ˆ æŠ¥è¡¨ç”Ÿæˆä¸æ•°æ®åˆ†æå®æˆ˜


### 8.1 æ—¥å¿—åˆ†æå®ä¾‹


**ğŸ” Apacheè®¿é—®æ—¥å¿—åˆ†æï¼š**
```bash
# åˆ†æaccess.logæ ¼å¼ï¼š
# IP - - [æ—¶é—´] "è¯·æ±‚" çŠ¶æ€ç  å¤§å° "æ¥æº" "æµè§ˆå™¨"

awk '
BEGIN {
    print "ç½‘ç«™è®¿é—®åˆ†ææŠ¥å‘Š"
    print "=================="
}

{
    # æå–å…³é”®ä¿¡æ¯
    ip = $1
    status = $9
    size = $10
    
    # ç»Ÿè®¡è®¿é—®
    total_requests++
    ip_count[ip]++
    status_count[status]++
    if (size != "-") total_size += size
}

END {
    print "\næ€»ä½“ç»Ÿè®¡:"
    print "æ€»è¯·æ±‚æ•°:", total_requests
    printf "ä¼ è¾“æ€»é‡: %.2f MB\n", total_size/1024/1024
    
    print "\nçŠ¶æ€ç ç»Ÿè®¡:"
    for (s in status_count)
        printf "  %s: %d (%.1f%%)\n", s, status_count[s], 
               status_count[s]/total_requests*100
    
    print "\nTop 10 è®¿é—®IP:"
    # æŒ‰è®¿é—®æ¬¡æ•°æ’åºè¾“å‡º
    PROCINFO["sorted_in"] = "@val_num_desc"
    count = 0
    for (ip in ip_count) {
        printf "  %-15s %d\n", ip, ip_count[ip]
        if (++count >= 10) break
    }
}' access.log
```

### 8.2 è´¢åŠ¡æ•°æ®åˆ†æ


**ğŸ’° é”€å”®æ•°æ®ç»Ÿè®¡ï¼š**
```bash
# é”€å”®è®°å½•æ ¼å¼ï¼šæ—¥æœŸ,äº§å“,æ•°é‡,å•ä»·,é”€å”®å‘˜
# 2024-01-15,ç¬”è®°æœ¬ç”µè„‘,2,5999.00,å¼ ä¸‰

awk -F',' '
BEGIN {
    print "é”€å”®ä¸šç»©ç»Ÿè®¡æŠ¥å‘Š"
    print "=================="
}

NR > 1 {  # è·³è¿‡è¡¨å¤´
    date = $1
    product = $2
    quantity = $3
    price = $4
    salesman = $5
    
    # è®¡ç®—é‡‘é¢
    amount = quantity * price
    
    # å„ç§ç»Ÿè®¡
    total_amount += amount
    salesman_sales[salesman] += amount
    product_sales[product] += amount
    
    # æŒ‰æœˆç»Ÿè®¡
    month = substr(date, 1, 7)
    monthly_sales[month] += amount
}

END {
    printf "\næ€»é”€å”®é¢: Â¥%.2f\n", total_amount
    
    print "\né”€å”®å‘˜ä¸šç»©æ’è¡Œ:"
    PROCINFO["sorted_in"] = "@val_num_desc" 
    for (s in salesman_sales)
        printf "  %-10s Â¥%10.2f\n", s, salesman_sales[s]
    
    print "\näº§å“é”€å”®æ’è¡Œ:"
    for (p in product_sales)
        printf "  %-15s Â¥%10.2f\n", p, product_sales[p]
    
    print "\næœˆåº¦é”€å”®è¶‹åŠ¿:"
    PROCINFO["sorted_in"] = "@ind_str_asc"
    for (m in monthly_sales)
        printf "  %s: Â¥%10.2f\n", m, monthly_sales[m]
}' sales.csv
```

### 8.3 ç³»ç»Ÿæ€§èƒ½ç›‘æ§


**âš¡ ç³»ç»Ÿèµ„æºä½¿ç”¨åˆ†æï¼š**
```bash
# åˆ†ætopå‘½ä»¤è¾“å‡º
ps aux | awk '
NR == 1 { next }  # è·³è¿‡æ ‡é¢˜è¡Œ
{
    user = $1
    cpu = $3
    mem = $4
    command = $11
    
    # æŒ‰ç”¨æˆ·ç»Ÿè®¡èµ„æºä½¿ç”¨
    user_cpu[user] += cpu
    user_mem[user] += mem
    user_processes[user]++
    
    # è®°å½•é«˜èµ„æºæ¶ˆè€—è¿›ç¨‹
    if (cpu > 5.0 || mem > 5.0) {
        high_usage[NR] = sprintf("%-10s %6.1f%% %6.1f%% %s", 
                                user, cpu, mem, command)
    }
}

END {
    print "ç³»ç»Ÿèµ„æºä½¿ç”¨ç»Ÿè®¡"
    print "=================="
    
    print "\næŒ‰ç”¨æˆ·ç»Ÿè®¡:"
    for (u in user_cpu) {
        printf "%-10s è¿›ç¨‹:%2d CPU:%6.1f%% å†…å­˜:%6.1f%%\n", 
               u, user_processes[u], user_cpu[u], user_mem[u]
    }
    
    if (length(high_usage) > 0) {
        print "\né«˜èµ„æºæ¶ˆè€—è¿›ç¨‹:"
        for (i in high_usage)
            print "  " high_usage[i]
    }
}'
```

### 8.4 æ•°æ®è´¨é‡æ£€æŸ¥


**ğŸ” æ•°æ®å®Œæ•´æ€§éªŒè¯ï¼š**
```bash
# æ£€æŸ¥CSVæ•°æ®è´¨é‡
awk -F',' '
BEGIN {
    expected_fields = 5
    print "æ•°æ®è´¨é‡æ£€æŸ¥æŠ¥å‘Š"
    print "=================="
}

{
    line_num = NR
    field_count = NF
    
    # æ£€æŸ¥å­—æ®µæ•°é‡
    if (field_count != expected_fields) {
        errors[++error_count] = sprintf("è¡Œ%d: å­—æ®µæ•°ä¸æ­£ç¡®(%dä¸ªï¼Œåº”ä¸º%dä¸ª)", 
                                       line_num, field_count, expected_fields)
    }
    
    # æ£€æŸ¥å¿…å¡«å­—æ®µ
    for (i=1; i<=NF; i++) {
        if ($i == "" || $i == " ") {
            errors[++error_count] = sprintf("è¡Œ%d: ç¬¬%då­—æ®µä¸ºç©º", line_num, i)
        }
    }
    
    # æ£€æŸ¥æ•°æ®æ ¼å¼ï¼ˆå‡è®¾ç¬¬3å­—æ®µåº”ä¸ºæ•°å­—ï¼‰
    if ($3 !~ /^[0-9]+(\.[0-9]+)?$/) {
        errors[++error_count] = sprintf("è¡Œ%d: ç¬¬3å­—æ®µæ ¼å¼é”™è¯¯(%s)", line_num, $3)
    }
    
    total_records++
}

END {
    printf "\næ£€æŸ¥å®Œæˆ:\n"
    printf "æ€»è®°å½•æ•°: %d\n", total_records
    printf "é”™è¯¯æ•°é‡: %d\n", error_count
    
    if (error_count > 0) {
        printf "\né”™è¯¯è¯¦æƒ…:\n"
        for (i=1; i<=error_count; i++) {
            print "  " errors[i]
        }
        printf "\næ•°æ®è´¨é‡: %.1f%%\n", ((total_records-error_count)/total_records)*100
    } else {
        print "\nâœ“ æ•°æ®è´¨é‡è‰¯å¥½ï¼Œæ— é”™è¯¯å‘ç°"
    }
}' data.csv
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ awkæœ¬è´¨ï¼šé€è¡Œå¤„ç†ç»“æ„åŒ–æ–‡æœ¬çš„å¼ºå¤§å·¥å…·
ğŸ”¸ ç¨‹åºç»“æ„ï¼šBEGIN{åˆå§‹åŒ–} ä¸»å¤„ç†{æ¯è¡Œæ“ä½œ} END{æ±‡æ€»}  
ğŸ”¸ å­—æ®µæ¦‚å¿µï¼š$0æ•´è¡Œ $1ç¬¬ä¸€å­—æ®µ $NFæœ€åå­—æ®µ
ğŸ”¸ å†…ç½®å˜é‡ï¼šNRè¡Œå· NFå­—æ®µæ•° FSåˆ†éš”ç¬¦ FILENAMEæ–‡ä»¶å
ğŸ”¸ æ¨¡å¼åŒ¹é…ï¼šæ­£åˆ™è¡¨è¾¾å¼ã€æ¡ä»¶è¡¨è¾¾å¼ã€èŒƒå›´åŒ¹é…
ğŸ”¸ æ•°æ®å¤„ç†ï¼šç»Ÿè®¡ã€è®¡ç®—ã€æ ¼å¼åŒ–ã€å…³è”åˆ†æ
```

### 9.2 å­¦ä¹ è¿›é˜¶è·¯çº¿


**ğŸ”¹ åˆçº§åº”ç”¨**ï¼ˆæ—¥å¸¸æ–‡æœ¬å¤„ç†ï¼‰ï¼š
```
æŒæ¡å†…å®¹ï¼š
- åŸºæœ¬å­—æ®µæ“ä½œï¼šprint $1, $2
- ç®€å•ç»Ÿè®¡ï¼šè®¡æ•°ã€æ±‚å’Œã€å¹³å‡å€¼
- æ¡ä»¶è¿‡æ»¤ï¼šæŒ‰æ¡ä»¶ç­›é€‰è¡Œ
- æ ¼å¼åŒ–è¾“å‡ºï¼šå¯¹é½ã€å°æ•°æ§åˆ¶
```

**ğŸ”¹ ä¸­çº§åº”ç”¨**ï¼ˆæ•°æ®åˆ†æï¼‰ï¼š
```
æŒæ¡å†…å®¹ï¼š
- æ•°ç»„ç»Ÿè®¡ï¼šåˆ†ç»„è®¡æ•°ã€å»é‡
- å¤šæ–‡ä»¶å…³è”ï¼šæ•°æ®è¿æ¥ã€å¯¹æ¯”
- å¤æ‚æ¡ä»¶ï¼šå¤šé‡åˆ¤æ–­ã€æ¨¡å¼ç»„åˆ  
- å‡½æ•°åº”ç”¨ï¼šå­—ç¬¦ä¸²å¤„ç†ã€æ•°å­¦è®¡ç®—
```

**ğŸ”¹ é«˜çº§åº”ç”¨**ï¼ˆæŠ¥è¡¨ç”Ÿæˆï¼‰ï¼š
```
æŒæ¡å†…å®¹ï¼š
- æŠ¥è¡¨è®¾è®¡ï¼šæ ‡é¢˜ã€æ ¼å¼ã€æ±‡æ€»
- æ•°æ®æ¸…æ´—ï¼šéªŒè¯ã€æ ‡å‡†åŒ–ã€è¡¥å…¨
- æ€§èƒ½ä¼˜åŒ–ï¼šå¤§æ–‡ä»¶å¤„ç†æŠ€å·§
- è„šæœ¬ç¼–ç¨‹ï¼šå¤æ‚ä¸šåŠ¡é€»è¾‘å®ç°
```

### 9.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ’¼ å·¥ä½œä¸­çš„å…¸å‹ç”¨æ³•**ï¼š

| åº”ç”¨åœºæ™¯ | **awkå‘½ä»¤ç‰¹ç‚¹** | **è§£å†³çš„é—®é¢˜** |
|---------|---------------|---------------|
| **æ—¥å¿—åˆ†æ** | å­—æ®µæå– + ç»Ÿè®¡æ±‡æ€» | å¿«é€Ÿäº†è§£ç³»ç»ŸçŠ¶æ€å’Œå¼‚å¸¸ |
| **æ•°æ®æŠ¥è¡¨** | æ ¼å¼åŒ–è¾“å‡º + è®¡ç®— | ä»åŸå§‹æ•°æ®ç”Ÿæˆå¯è¯»æŠ¥å‘Š |
| **é…ç½®å¤„ç†** | æ¡ä»¶åŒ¹é… + æ–‡æœ¬æ›¿æ¢ | æ‰¹é‡ä¿®æ”¹é…ç½®æ–‡ä»¶ |
| **æ•°æ®æ¸…æ´—** | æ ¼å¼éªŒè¯ + æ ‡å‡†åŒ– | ç¡®ä¿æ•°æ®è´¨é‡å’Œä¸€è‡´æ€§ |
| **æ€§èƒ½ç›‘æ§** | å®æ—¶ç»Ÿè®¡ + é˜ˆå€¼åˆ¤æ–­ | è‡ªåŠ¨åŒ–ç›‘æ§å’Œé¢„è­¦ |

### 9.4 ä¸å…¶ä»–å·¥å…·çš„é…åˆ


**ğŸ”§ å·¥å…·é“¾ç»„åˆ**ï¼š
```bash
# awk + grepï¼šå…ˆè¿‡æ»¤å†åˆ†æ
grep "ERROR" app.log | awk '{error_count[$3]++} END {for(e in error_count) print e, error_count[e]}'

# awk + sortï¼šç»Ÿè®¡åæ’åº
awk '{count[$1]++} END {for(i in count) print count[i], i}' data.txt | sort -nr

# awk + ç®¡é“ï¼šæ„å»ºå¤„ç†é“¾
cat sales.csv | awk -F',' '{total+=$4} END {print total}' | xargs echo "æ€»é”€å”®é¢:"
```

**ğŸ¯ è®°å¿†è¦ç‚¹**ï¼š
- **å­—æ®µä¸ºç‹**ï¼šawkçš„æ ¸å¿ƒæ˜¯å­—æ®µæ“ä½œï¼Œç†Ÿç»ƒæŒæ¡$1, $2, $NFç­‰
- **æ¨¡å¼+åŠ¨ä½œ**ï¼šç†è§£"ä»€ä¹ˆæ—¶å€™åšä»€ä¹ˆ"çš„åŸºæœ¬ç»“æ„
- **ç»Ÿè®¡æ€ç»´**ï¼šå–„ç”¨æ•°ç»„è¿›è¡Œåˆ†ç»„ç»Ÿè®¡å’Œæ•°æ®æ±‡æ€»
- **æ ¼å¼åŒ–è¾“å‡º**ï¼šprintfè®©æŠ¥è¡¨æ›´ä¸“ä¸šç¾è§‚
- **å®è·µä¸ºä¸»**ï¼šå¤šç»ƒä¹ çœŸå®æ•°æ®å¤„ç†åœºæ™¯

**ğŸ’¡ å­¦ä¹ å»ºè®®**ï¼š
ä»ç®€å•çš„å­—æ®µæå–å¼€å§‹ï¼Œé€æ­¥å­¦ä¼šæ¡ä»¶åˆ¤æ–­ã€æ•°ç»„ç»Ÿè®¡ï¼Œæœ€åæŒæ¡å¤æ‚çš„æ•°æ®åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚awkæœ€å¤§çš„ä»·å€¼åœ¨äºèƒ½å¤Ÿå¿«é€Ÿå¤„ç†ç»“æ„åŒ–æ–‡æœ¬ï¼Œè§£å†³å®é™…å·¥ä½œä¸­çš„æ•°æ®åˆ†æéœ€æ±‚ã€‚