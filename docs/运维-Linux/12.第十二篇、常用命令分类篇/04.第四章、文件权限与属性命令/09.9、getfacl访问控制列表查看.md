---
title: 9、getfacl访问控制列表查看
---
## 📚 目录

1. [ACL访问控制列表概念](#1-ACL访问控制列表概念)
2. [getfacl命令基本用法](#2-getfacl命令基本用法)
3. [ACL条目格式解读](#3-ACL条目格式解读)
4. [用户ACL与组ACL](#4-用户ACL与组ACL)
5. [默认ACL与继承机制](#5-默认ACL与继承机制)
6. [ACL与传统权限关系](#6-ACL与传统权限关系)
7. [ACL信息完整显示](#7-ACL信息完整显示)
8. [ACL权限计算规则](#8-ACL权限计算规则)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🔐 ACL访问控制列表概念


### 1.1 什么是ACL

**ACL（Access Control List）** 是一种比传统Unix权限更灵活的权限控制系统。

> 💡 **通俗理解**：如果说传统权限像是"一刀切"的门锁，那么ACL就像是"智能门锁"，可以为不同的人设置不同的开门权限。

**为什么需要ACL？**
传统Unix权限只能设置：
- 文件所有者的权限
- 文件所属组的权限  
- 其他人的权限

但现实中我们经常需要：
- 让张三有读权限，李四有写权限
- 让A组有读权限，B组有执行权限
- 为特定用户定制权限，而不影响其他人

### 1.2 ACL的核心优势


```
传统权限限制：
文件: document.txt
所有者: alice (rwx)
所属组: staff (r--)  
其他人: (---)

问题：如果要让bob用户也有写权限，但bob不在staff组怎么办？

ACL解决方案：
可以单独为bob用户设置写权限，不影响其他设置
```

**ACL的三大优势：**
- ✅ **精细控制** - 可以为任意用户/组设置权限
- ✅ **灵活扩展** - 不受传统3类用户限制
- ✅ **继承机制** - 支持目录默认权限继承

---

## 2. 🔍 getfacl命令基本用法


### 2.1 命令格式


```bash
getfacl [选项] 文件或目录
```

### 2.2 最常用的基本语法


**查看单个文件的ACL：**
```bash
getfacl /home/test.txt
```

**查看多个文件的ACL：**
```bash
getfacl file1.txt file2.txt dir1/
```

### 2.3 重要选项说明


| 选项 | 含义 | 使用场景 |
|------|------|----------|
| `-a` | 只显示ACL条目 | 简化输出，专注ACL信息 |
| `-d` | 只显示默认ACL | 查看目录的继承权限设置 |
| `-c` | 不显示注释 | 脚本处理时简化输出 |
| `-e` | 显示有效权限 | 理解实际生效的权限 |
| `-R` | 递归显示 | 查看目录树的ACL设置 |

### 2.4 实际使用示例


```bash
# 查看文件基本ACL信息
getfacl /home/alice/document.txt

# 查看目录及子项的ACL（递归）
getfacl -R /home/shared/

# 只看默认ACL设置
getfacl -d /home/shared/
```

---

## 3. 📋 ACL条目格式解读


### 3.1 ACL输出格式详解


当你运行 `getfacl` 命令时，会看到类似这样的输出：

```
# file: /home/test.txt
# owner: alice
# group: staff
user::rw-
user:bob:r--
group::r--
group:admin:rwx
mask::rwx
other::---
```

### 3.2 输出信息分类


**🔸 文件基本信息**
```
# file: /home/test.txt     ← 文件路径
# owner: alice            ← 文件所有者
# group: staff            ← 文件所属组
```

**🔸 权限条目格式**
每个权限条目的格式是：`类型:名称:权限`

```
权限条目结构图：
┌─────────┬─────────┬─────────┐
│  类型   │  名称   │  权限   │
├─────────┼─────────┼─────────┤
│  user   │  bob    │  r--    │
└─────────┴─────────┴─────────┘
   ↑         ↑         ↑
   │         │         └── rwx权限位
   │         └── 具体用户名/组名
   └── user/group/mask/other
```

### 3.3 权限类型详解


**user类型权限：**
- `user::rw-` - 文件所有者的权限
- `user:bob:r--` - 指定用户bob的权限

**group类型权限：**  
- `group::r--` - 文件所属组的权限
- `group:admin:rwx` - 指定组admin的权限

**特殊条目：**
- `mask::rwx` - 有效权限掩码
- `other::---` - 其他人的权限

---

## 4. 👥 用户ACL与组ACL


### 4.1 用户ACL设置


**用户ACL的作用：**
为特定用户设置独立的文件权限，不受组权限限制。

```bash
# 查看包含用户ACL的文件
getfacl /shared/project.txt
```

典型输出：
```
# file: /shared/project.txt
# owner: alice
# group: developers
user::rw-              ← 所有者alice的权限
user:bob:r--           ← 用户bob的只读权限  
user:carol:rwx         ← 用户carol的完全权限
group::r--             ← developers组的权限
mask::rwx
other::---
```

> 🔧 **实践说明**：这种设置允许在同一个文件上为不同用户分配完全不同的权限级别。

### 4.2 组ACL设置


**组ACL的作用：**
为特定组设置权限，实现更灵活的组权限管理。

```bash
# 查看包含组ACL的目录
getfacl /shared/docs/
```

典型输出：
```
# file: /shared/docs/
# owner: root
# group: staff
user::rwx
group::r-x             ← staff组的基本权限
group:admin:rwx        ← admin组的完全权限
group:guests:r--       ← guests组的只读权限
mask::rwx
other::---
```

### 4.3 混合ACL权限


**实际工作中的复杂权限示例：**

```
项目目录权限设计：
/project/webapp/
├── 项目经理: rwx (完全控制)
├── 开发组: rwx (开发权限)  
├── 测试组: r-x (只读执行)
├── 运维组: r-- (只读权限)
└── 其他人: --- (无权限)
```

对应的ACL设置会显示为：
```
user::rwx                 # 项目经理权限
group:developers:rwx      # 开发组权限
group:testers:r-x        # 测试组权限  
group:ops:r--            # 运维组权限
other::---               # 其他人无权限
```

---

## 5. 🔄 默认ACL与继承机制


### 5.1 默认ACL概念


**默认ACL** 只能设置在目录上，用于定义在该目录下创建的新文件和子目录的权限。

> 📖 **概念理解**：默认ACL就像是"权限模板"，新创建的文件会自动继承这个模板。

### 5.2 查看默认ACL


```bash
# 专门查看目录的默认ACL
getfacl -d /shared/templates/
```

典型输出：
```
# file: /shared/templates/
# owner: admin
# group: staff
default:user::rwx          ← 新文件的所有者权限
default:group::r-x         ← 新文件的组权限
default:group:dev:rwx      ← 新文件dev组的权限
default:mask::rwx          ← 新文件的权限掩码
default:other::r--         ← 新文件其他人权限
```

### 5.3 继承机制工作原理


**继承流程图：**
```
父目录                    新建文件
/shared/docs/            test.txt
├─ default ACL    ────→   继承为普通ACL
│  default:user::rw-     user::rw-
│  default:group::r--    group::r--
│  default:other::---    other::---
```

**实际验证继承：**
```bash
# 1. 查看父目录默认ACL
getfacl -d /shared/docs/

# 2. 在该目录创建新文件  
touch /shared/docs/newfile.txt

# 3. 查看新文件继承的ACL
getfacl /shared/docs/newfile.txt
```

### 5.4 完整ACL显示


当目录既有普通ACL又有默认ACL时：

```bash
getfacl /shared/project/
```

完整输出：
```
# file: /shared/project/
# owner: alice  
# group: team
user::rwx                  ← 当前目录的权限
group::r-x
group:admin:rwx
mask::rwx
other::---
default:user::rwx          ← 新文件继承的权限
default:group::r-x
default:group:admin:rwx  
default:mask::rwx
default:other::---
```

---

## 6. ⚖️ ACL与传统权限关系


### 6.1 权限系统的层次关系


```
Linux权限系统架构：
┌─────────────────────┐
│    传统权限 (UGO)    │ ← 基础权限层
├─────────────────────┤
│    扩展权限 (ACL)    │ ← 精细控制层  
├─────────────────────┤
│   SELinux/AppArmor  │ ← 安全增强层
└─────────────────────┘
```

### 6.2 ACL对传统权限的影响


**传统ls -l显示变化：**
```bash
# 没有ACL的文件
-rw-r--r-- 1 alice staff 1024 Jan 20 10:00 normal.txt

# 有ACL的文件  
-rw-r--r--+ 1 alice staff 1024 Jan 20 10:00 acl_file.txt
           ↑
           ACL标识符
```

> ⚠️ **重要标识**：文件权限后的 **+** 号表示该文件设置了ACL权限。

### 6.3 权限计算的优先级


**权限检查顺序：**
1. 如果是文件所有者 → 使用owner权限
2. 如果匹配用户ACL → 使用用户ACL权限  
3. 如果属于文件组或匹配组ACL → 使用相应组权限
4. 否则 → 使用other权限

**权限计算示例：**
```
用户bob访问文件时的权限计算：
1. bob不是文件所有者 ✗
2. 检查user:bob:rw- ✓ (匹配)
3. 最终权限: rw- (读写权限)
```

---

## 7. 📊 ACL信息完整显示


### 7.1 详细显示选项


**显示所有信息：**
```bash
# 显示完整ACL信息和有效权限
getfacl -e /shared/data/
```

输出包含有效权限：
```
# file: /shared/data/
# owner: root
# group: staff  
user::rwx
user:alice:rw-          #effective:rw-
user:bob:rwx            #effective:r-x  
group::r-x              #effective:r-x
mask::r-x
other::---
```

### 7.2 有效权限计算


> 💡 **核心概念**：有效权限 = 设置权限 AND mask权限

**权限掩码作用：**
```
权限计算公式：
实际生效权限 = 用户/组ACL权限 ∩ mask权限

示例计算：
user:bob:rwx (设置权限)
mask::r-x    (权限掩码)  
─────────────────────
effective:r-x (有效权限)
```

### 7.3 简化输出格式


**只显示ACL条目：**
```bash
getfacl -a /home/test.txt
```

输出：
```
user::rw-
user:bob:r--
group::r--  
mask::rw-
other::---
```

**无注释显示：**
```bash
getfacl -c /home/test.txt
```

输出会省略 `# file:`, `# owner:` 等注释行。

---

## 8. 🧮 ACL权限计算规则


### 8.1 权限位的含义


**标准权限位解释：**
```
权限位对照表：
┌───┬────────┬──────┬──────┐
│ 位 │  符号  │ 数值 │ 含义 │  
├───┼────────┼──────┼──────┤
│ r │   r    │  4   │ 读权限│
│ w │   w    │  2   │ 写权限│
│ x │   x    │  1   │执行权限│
│ - │   -    │  0   │无权限 │
└───┴────────┴──────┴──────┘
```

### 8.2 mask权限的作用


**mask权限掩码机制：**

mask权限限制了除owner和other外所有权限的上限：
- 用户ACL的有效权限 = 用户ACL权限 & mask权限
- 组权限的有效权限 = 组权限 & mask权限
- 组ACL的有效权限 = 组ACL权限 & mask权限

**实例计算：**
```
设置情况：
user:alice:rwx    (用户alice设置为rwx)
mask::r-x         (mask限制为r-x)

计算过程：
rwx & r-x = r-x

结果：alice的有效权限是r-x(读和执行)
```

### 8.3 复杂权限计算示例


**多用户多组权限计算：**

假设文件ACL设置为：
```
user::rw-
user:bob:rwx      #effective:rw-
user:carol:r--    #effective:r--
group::r-x        #effective:r-x  
group:admin:rwx   #effective:rw-
mask::rw-
other::---
```

**各用户实际权限：**
- **文件所有者**: rw- (不受mask影响)
- **bob用户**: rw- (rwx被mask限制为rw-)
- **carol用户**: r-- (r--与mask取交集仍是r--)
- **admin组成员**: rw- (rwx被mask限制为rw-)
- **staff组成员**: r-- (r-x被mask限制为r--)
- **其他用户**: --- (无权限)

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 ACL本质：比传统UGO更灵活的权限控制系统
🔸 getfacl作用：查看和分析文件目录的ACL权限设置  
🔸 权限条目格式：类型:名称:权限 (如user:bob:rw-)
🔸 默认ACL：目录的权限继承模板机制
🔸 mask权限：除owner/other外所有权限的上限控制
🔸 有效权限：实际生效权限 = 设置权限 & mask权限
```

### 9.2 关键理解要点


**🔹 ACL的实际价值**
```
解决场景：
- 多用户协作项目的精细权限控制
- 跨部门文件共享的安全管理
- 临时权限授予而不改变组结构
- 权限继承的自动化管理
```

**🔹 权限查看的技巧**
```
查看策略：
- 基本查看：getfacl 文件名
- 递归查看：getfacl -R 目录
- 默认权限：getfacl -d 目录  
- 有效权限：getfacl -e 文件
```

**🔹 mask权限的关键作用**
```
理解要点：
- mask是"权限天花板"，限制最大权限
- 修改传统组权限会自动调整mask
- 理解effective权限对排查问题很重要
```

### 9.3 实际应用指导


**🎯 使用场景判断**
- ✅ **多用户项目** - 不同用户需要不同权限级别
- ✅ **部门协作** - 跨组访问但需要权限控制
- ✅ **权限继承** - 希望新文件自动获得合适权限
- ✅ **临时授权** - 短期给用户特殊权限

**⚡ 权限诊断技巧**
```
问题排查流程：
1. 用ls -l检查是否有ACL(+号标识)
2. 用getfacl查看完整权限设置
3. 关注mask权限对有效权限的限制  
4. 检查默认ACL的继承影响
```

**💡 最佳实践建议**
- 定期审查ACL设置，避免权限过度授予
- 合理使用默认ACL简化权限管理
- 理解mask机制，避免权限设置无效
- 结合传统权限和ACL权限灵活使用

**核心记忆口诀**：
```
ACL权限更灵活，getfacl来查看
用户组权限分开设，mask掩码定上限  
默认权限可继承，有效权限要计算
加号标识有扩展，权限管理更简单
```