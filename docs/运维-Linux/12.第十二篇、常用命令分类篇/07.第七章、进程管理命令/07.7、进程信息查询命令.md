---
title: 7、进程信息查询命令
---
## 📚 目录

1. [lsof查看进程打开文件](#1-lsof查看进程打开文件)
2. [fuser查看文件使用进程](#2-fuser查看文件使用进程)
3. [/proc文件系统进程信息](#3-proc文件系统进程信息)
4. [进程内存映射查看](#4-进程内存映射查看)
5. [进程网络连接查看](#5-进程网络连接查看)
6. [进程环境变量查看](#6-进程环境变量查看)
7. [进程工作目录与命令行](#7-进程工作目录与命令行)
8. [进程启动时间与运行时长](#8-进程启动时间与运行时长)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🔍 lsof查看进程打开文件


### 1.1 lsof基本概念


**lsof**的全称是`list open files`，顾名思义就是"列出打开的文件"。在Linux中，**一切皆文件**，所以lsof能查看进程打开的所有资源。

> **💡 核心理解**
> lsof = "进程的透视镜"，能看到进程正在使用的所有文件、网络连接、设备等

**🔸 lsof能查看什么：**
```
常规文件：程序打开的配置文件、数据文件
网络连接：TCP/UDP连接、监听端口
设备文件：终端、磁盘设备
管道文件：进程间通信管道
内存映射：共享库、程序代码段
```

### 1.2 基本使用方法


**⚡ 常用命令格式：**

| 用途 | **命令** | **说明** |
|------|----------|----------|
| 查看所有打开文件 | `lsof` | 显示系统所有打开文件 |
| 查看指定进程 | `lsof -p 1234` | 查看PID为1234的进程 |
| 查看指定文件 | `lsof /var/log/syslog` | 查看谁在使用该文件 |
| 查看网络连接 | `lsof -i` | 查看所有网络连接 |
| 查看端口占用 | `lsof -i :80` | 查看80端口占用情况 |

**📋 输出信息解读：**
```bash
$ lsof -p 1234
COMMAND  PID USER FD   TYPE DEVICE SIZE/OFF    NODE NAME
firefox 1234 user cwd   DIR   8,1     4096 2097153 /home/user
firefox 1234 user txt   REG   8,1  1048576 1234567 /usr/bin/firefox
firefox 1234 user  3r   REG   8,1     1024 7654321 /etc/hosts
firefox 1234 user  4w   REG   8,1        0 9876543 /tmp/firefox.log
```

**🔍 字段含义说明：**
- `COMMAND`：进程名称
- `PID`：进程ID
- `USER`：进程所有者
- `FD`：文件描述符（`cwd`=工作目录，`txt`=程序文件，数字=打开文件）
- `TYPE`：文件类型（`DIR`=目录，`REG`=普通文件，`CHR`=字符设备）
- `NAME`：文件完整路径

### 1.3 实用查询技巧


**🎯 网络连接监控：**
```bash
# 查看所有网络连接
lsof -i

# 查看TCP连接
lsof -iTCP

# 查看UDP连接  
lsof -iUDP

# 查看指定端口
lsof -i :22    # SSH端口
lsof -i :80    # HTTP端口

# 查看指定IP连接
lsof -i @192.168.1.100
```

**🔧 文件操作监控：**
```bash
# 查看删除但未释放的文件（磁盘空间清理）
lsof | grep deleted

# 查看指定目录下的文件使用
lsof +D /var/log

# 查看进程打开的日志文件
lsof -c nginx | grep log
```

---

## 2. 👥 fuser查看文件使用进程


### 2.1 fuser基本概念


**fuser**是`file user`的缩写，专门用来查看"哪些进程在使用指定文件或目录"，与lsof互补使用。

> **💡 对比理解**
> - lsof：从进程角度看文件（进程打开了哪些文件）
> - fuser：从文件角度看进程（文件被哪些进程使用）

### 2.2 基本使用方法


**⚡ 常用操作：**
```bash
# 查看文件被哪些进程使用
fuser /var/log/syslog

# 显示详细信息（进程名和用户）
fuser -v /var/log/syslog

# 查看目录使用情况
fuser -v /home/user/

# 杀死使用文件的进程
fuser -k /var/log/syslog
```

**📊 访问类型标识：**

| 标识 | **含义** | **说明** |
|------|----------|----------|
| `c` | current directory | 当前工作目录 |
| `e` | executable | 可执行文件 |
| `f` | open file | 打开的文件 |
| `F` | open file for writing | 写入模式打开 |
| `r` | root directory | 根目录 |
| `m` | mmap'ed file | 内存映射文件 |

### 2.3 实用场景


**🔸 解决设备忙碌问题：**
```bash
# 无法卸载磁盘时查看占用进程
fuser -mv /mnt/usb

# 示例输出：
#                      USER        PID ACCESS COMMAND
# /mnt/usb:            root      kernel mount /mnt/usb
#                      user        1234 ..c.. bash
#                      user        5678 .f... vim
```

**🔹 清理僵尸进程：**
```bash
# 查看并终止占用文件的进程
fuser -k -TERM /var/lock/program.lock

# 强制终止
fuser -k -KILL /var/run/daemon.pid
```

---

## 3. 📁 /proc文件系统进程信息


### 3.1 /proc文件系统概述


**/proc文件系统**是Linux的"信息宝库"，每个运行进程在`/proc/PID/`目录下都有详细信息，这些都是**虚拟文件**（内存中动态生成）。

```
/proc文件系统结构：
/proc/
├── 1/           ← PID为1的进程（通常是init）
├── 1234/        ← PID为1234的进程
│   ├── cmdline  ← 启动命令行参数
│   ├── environ  ← 环境变量
│   ├── cwd      ← 工作目录（符号链接）
│   ├── exe      ← 可执行文件（符号链接）
│   ├── fd/      ← 打开的文件描述符
│   ├── maps     ← 内存映射信息
│   ├── stat     ← 进程状态统计
│   ├── status   ← 进程状态详细信息
│   └── ...
├── cpuinfo      ← CPU信息
├── meminfo      ← 内存信息
└── ...
```

### 3.2 核心进程信息文件


**📋 重要信息文件详解：**

| 文件名 | **内容** | **用途** |
|--------|----------|----------|
| `cmdline` | 启动命令行 | 查看程序如何启动 |
| `environ` | 环境变量 | 查看进程环境设置 |
| `cwd` | 工作目录 | 当前工作路径 |
| `exe` | 可执行文件 | 程序本体位置 |
| `fd/` | 文件描述符 | 打开的文件列表 |
| `maps` | 内存映射 | 内存使用详情 |
| `stat` | 状态统计 | 进程基本统计信息 |
| `status` | 详细状态 | 可读性强的状态信息 |

### 3.3 实用查询方法


**🔍 快速查看进程信息：**
```bash
# 查看进程启动命令（以null分隔，需要处理）
cat /proc/1234/cmdline | tr '\0' ' '

# 查看进程环境变量
cat /proc/1234/environ | tr '\0' '\n'

# 查看进程工作目录
ls -l /proc/1234/cwd

# 查看进程可执行文件
ls -l /proc/1234/exe
```

**📊 内存和状态信息：**
```bash
# 查看内存使用情况
cat /proc/1234/status | grep -E "(VmSize|VmRSS|VmData)"

# 查看进程打开的文件
ls -l /proc/1234/fd/

# 查看网络连接
cat /proc/1234/net/tcp
```

---

## 4. 🧠 进程内存映射查看


### 4.1 内存映射基本概念


**内存映射**显示进程在虚拟内存中的布局，包括代码段、数据段、堆栈、共享库等区域的分布情况。

> **💡 生活类比**
> 就像查看一本书的目录，能看到每章节内容在第几页，进程内存映射显示各部分数据在内存中的位置

### 4.2 查看方法详解


**🔧 主要查看方式：**
```bash
# 方法1：查看/proc/PID/maps文件
cat /proc/1234/maps

# 方法2：使用pmap命令（更友好的显示）
pmap 1234

# 方法3：详细内存统计
pmap -d 1234

# 方法4：按大小排序显示
pmap -S 1234
```

**📋 内存映射信息解读：**
```bash
$ cat /proc/1234/maps
# 地址范围          权限  偏移   设备   inode   文件路径
7f8b4c000000-7f8b4c021000 rw-p 00000000 00:00 0      [heap]
7f8b4c400000-7f8b4c500000 r-xp 00000000 08:01 123456 /lib/libc.so.6
7f8b4c500000-7f8b4c600000 rw-p 00100000 08:01 123456 /lib/libc.so.6
7fff12345000-7fff12366000 rw-p 00000000 00:00 0      [stack]
```

**🔍 权限标识含义：**
- `r`：可读（read）
- `w`：可写（write）  
- `x`：可执行（execute）
- `p`：私有映射（private）
- `s`：共享映射（shared）

### 4.3 内存区域类型


**📊 常见内存区域：**

| 区域类型 | **特征** | **作用** |
|----------|----------|----------|
| `[heap]` | 动态分配内存 | 程序运行时申请的内存 |
| `[stack]` | 程序栈 | 函数调用、局部变量 |
| `[vdso]` | 虚拟动态共享对象 | 系统调用优化 |
| `.so文件` | 共享库 | 动态链接库 |
| 可执行文件 | 程序本体 | 代码段、数据段 |

---

## 5. 🌐 进程网络连接查看


### 5.1 网络连接信息概述


每个进程的网络活动都会在系统中留下记录，包括监听的端口、建立的连接、网络统计等信息。

### 5.2 查看方法汇总


**⚡ 多种查看方式：**

| 命令 | **优势** | **适用场景** |
|------|----------|-------------|
| `netstat -p` | 传统工具，功能全面 | 详细分析网络状态 |
| `ss -p` | 现代工具，速度快 | 快速查看连接信息 |
| `lsof -i` | 文件视角，信息丰富 | 关联文件和网络 |
| `/proc/PID/net/` | 底层信息，最详细 | 深度分析和调试 |

**🔧 实用命令示例：**
```bash
# 查看进程的所有网络连接
netstat -p | grep 1234

# 查看进程监听的端口
ss -lntp | grep 1234

# 查看TCP连接详情
lsof -iTCP -sPID=1234

# 直接查看proc信息
cat /proc/1234/net/tcp
```

### 5.3 网络状态解读


**📊 连接状态说明：**
- `LISTEN`：监听状态，等待连接
- `ESTABLISHED`：已建立连接
- `TIME_WAIT`：连接关闭后的等待状态
- `CLOSE_WAIT`：等待关闭连接
- `SYN_SENT`：正在建立连接

**🔍 实际应用场景：**
```bash
# 找出占用80端口的进程
lsof -i :80

# 查看Web服务器的连接数
ss -ant | grep :80 | grep ESTABLISHED | wc -l

# 监控进程网络活动变化
watch -n 1 "lsof -i -sPID=1234"
```

---

## 6. 🌍 进程环境变量查看


### 6.1 环境变量的重要性


**环境变量**是进程运行时的配置信息，影响程序行为，包括路径设置、语言选项、系统配置等。

> **💡 实际意义**
> 环境变量就像进程的"个人设置"，决定了程序如何运行和在哪里找到需要的资源

### 6.2 查看方法


**🔧 多种查看方式：**
```bash
# 方法1：查看/proc下的environ文件
cat /proc/1234/environ | tr '\0' '\n'

# 方法2：使用ps命令显示环境变量
ps eww 1234

# 方法3：通过/proc下的cmdline和environ结合查看
strings /proc/1234/environ
```

**📋 常见环境变量类型：**

| 变量类型 | **示例** | **作用** |
|----------|----------|----------|
| 路径相关 | `PATH, HOME, PWD` | 程序查找路径 |
| 系统配置 | `LANG, LC_ALL` | 语言和本地化 |
| 程序配置 | `JAVA_HOME, PYTHONPATH` | 特定程序设置 |
| 显示相关 | `DISPLAY, TERM` | 图形界面和终端 |

### 6.3 环境变量分析技巧


**🎯 实用分析方法：**
```bash
# 查看特定环境变量
grep "^PATH=" /proc/1234/environ | tr '\0' '\n'

# 比较不同进程的环境变量
diff <(cat /proc/1234/environ | tr '\0' '\n' | sort) \
     <(cat /proc/5678/environ | tr '\0' '\n' | sort)

# 统计环境变量数量
cat /proc/1234/environ | tr '\0' '\n' | wc -l
```

---

## 7. 📂 进程工作目录与命令行


### 7.1 工作目录查看


**工作目录**是进程执行时的当前路径，影响相对路径的解析和文件操作。

**🔧 查看方法：**
```bash
# 方法1：查看cwd符号链接
ls -l /proc/1234/cwd

# 方法2：使用readlink获取实际路径
readlink /proc/1234/cwd

# 方法3：使用pwdx命令（如果可用）
pwdx 1234
```

### 7.2 命令行参数查看


**命令行参数**显示进程是如何启动的，包括程序名、参数选项、配置文件等。

**⚡ 查看技巧：**
```bash
# 标准查看（参数以null分隔）
cat /proc/1234/cmdline

# 格式化显示（转换null为空格）
cat /proc/1234/cmdline | tr '\0' ' ' && echo

# 每个参数一行显示
cat /proc/1234/cmdline | tr '\0' '\n'

# 使用ps命令查看（更友好）
ps -p 1234 -o pid,ppid,cmd
```

### 7.3 启动信息分析


**📊 综合分析示例：**
```bash
# 创建进程信息摘要脚本
analyze_process() {
    local pid=$1
    echo "=== 进程 $pid 信息分析 ==="
    echo "工作目录: $(readlink /proc/$pid/cwd)"
    echo "可执行文件: $(readlink /proc/$pid/exe)"
    echo "启动命令: $(cat /proc/$pid/cmdline | tr '\0' ' ')"
    echo "父进程: $(awk '{print $4}' /proc/$pid/stat)"
}

analyze_process 1234
```

---

## 8. ⏰ 进程启动时间与运行时长


### 8.1 时间信息获取


进程的时间信息帮助了解程序运行状况、性能分析和故障排查。

**🔧 查看方法对比：**

| 命令 | **显示内容** | **精确度** | **易读性** |
|------|------------|-----------|-----------|
| `ps -o etime` | 运行时长 | 秒级 | ⭐⭐⭐ |
| `ps -o lstart` | 启动时间 | 秒级 | ⭐⭐⭐ |
| `stat /proc/PID` | 详细时间戳 | 纳秒级 | ⭐⭐ |
| `/proc/PID/stat` | 系统时钟数 | 系统精度 | ⭐ |

### 8.2 实用查询命令


**⚡ 时间查询技巧：**
```bash
# 查看进程运行时长
ps -p 1234 -o pid,etime,cmd

# 查看进程启动时间
ps -p 1234 -o pid,lstart,cmd

# 查看详细时间信息
stat /proc/1234 | grep -E "(Birth|Access|Modify)"

# 批量查看多个进程时间
ps -o pid,ppid,lstart,etime,cmd -p 1234,5678,9012
```

### 8.3 时间分析应用


**🎯 实际应用场景：**

**性能分析：**
```bash
# 找出运行时间最长的进程
ps -eo pid,etime,cmd --sort=-etime | head -10

# 找出最近启动的进程
ps -eo pid,lstart,cmd --sort=-lstart | head -10
```

**故障排查：**
```bash
# 检查进程是否频繁重启
ps -eo pid,lstart,cmd | grep nginx

# 监控进程运行时长变化
watch -n 5 "ps -p 1234 -o pid,etime,cmd"
```

---

## 9. 📋 核心要点总结


### 9.1 命令工具对比总结


**🔍 进程信息查询工具选择指南：**

| 需求场景 | **推荐工具** | **核心优势** |
|----------|-------------|-------------|
| 查看进程文件使用 | `lsof -p PID` | 信息最全面 |
| 查看文件被谁占用 | `fuser -v file` | 针对性强 |
| 底层详细信息 | `/proc/PID/` | 原始准确 |
| 网络连接分析 | `ss -p`或`lsof -i` | 现代化工具 |
| 快速状态查看 | `ps`命令组合 | 简单直观 |

### 9.2 实用命令速查


**⚡ 必会命令组合：**
```bash
# 进程全面体检
check_process() {
    local pid=$1
    echo "📊 进程 $pid 完整信息："
    echo "状态: $(ps -p $pid -o stat --no-headers)"
    echo "运行时长: $(ps -p $pid -o etime --no-headers)"
    echo "工作目录: $(readlink /proc/$pid/cwd 2>/dev/null)"
    echo "打开文件数: $(lsof -p $pid 2>/dev/null | wc -l)"
    echo "网络连接数: $(lsof -i -sPID=$pid 2>/dev/null | wc -l)"
}
```

### 9.3 关键理解要点


**🎯 核心概念记忆：**

> **一切皆文件理念**
> Linux中进程、网络、设备都是文件，所以lsof能查看进程的所有资源使用情况

> **/proc是信息宝库**
> 每个进程的详细信息都在`/proc/PID/`目录下，这是最原始准确的数据源

> **工具互补使用**
> 不同工具有各自优势，组合使用效果更好：lsof看文件，fuser看占用，/proc看底层

### 9.4 实际应用场景


**🔧 日常运维场景：**
- **磁盘空间问题**：`lsof | grep deleted` 找出删除但未释放的文件
- **端口占用排查**：`lsof -i :端口号` 快速定位占用进程
- **进程异常分析**：查看`/proc/PID/`下的详细信息
- **网络连接监控**：结合`ss`和`lsof`监控网络活动
- **内存使用分析**：通过`pmap`和`/proc/PID/maps`分析内存布局

**💡 学习进阶建议：**
1. **多动手实践**：在安全环境中尝试各种命令组合
2. **关注性能影响**：某些命令（如lsof）可能对系统性能有影响
3. **结合监控工具**：配合htop、iotop等工具使用效果更佳
4. **建立查询脚本**：将常用的查询组合封装成脚本提高效率

**🎯 记忆口诀：**
- lsof看进程开啥文件，fuser看文件被谁占用
- /proc目录是宝库，进程信息全都有
- 网络连接ss最快，内存映射pmap瞧
- 时间信息ps命令，环境变量proc找