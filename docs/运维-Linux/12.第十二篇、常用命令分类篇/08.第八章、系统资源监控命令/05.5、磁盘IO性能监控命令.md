---
title: 5、磁盘IO性能监控命令
---
## 📚 目录

1. [磁盘IO监控概述](#1-磁盘IO监控概述)
2. [iostat命令详解](#2-iostat命令详解)
3. [iotop命令详解](#3-iotop命令详解)
4. [IO性能指标深度解析](#4-IO性能指标深度解析)
5. [磁盘类型与性能特征](#5-磁盘类型与性能特征)
6. [IO瓶颈识别与优化](#6-IO瓶颈识别与优化)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 💾 磁盘IO监控概述


### 1.1 什么是磁盘IO监控


**🔸 简单理解**
磁盘IO监控就像是给硬盘装了一个"监控摄像头"，实时观察硬盘的工作状态：
- 硬盘现在有多忙？
- 数据读写速度如何？
- 哪个程序在大量使用硬盘？

**💡 为什么需要监控磁盘IO**
```
生活类比：
就像监控交通路况一样
🚗 车流量 = IO请求数量
🛣️ 道路宽度 = 硬盘带宽
⏱️ 通行时间 = IO响应时间
🚦 红绿灯 = IO等待队列
```

### 1.2 磁盘IO的基本工作原理


**⚙️ IO操作流程图**
```
应用程序
    ↓ 发起读写请求
操作系统内核
    ↓ 将请求放入IO队列
硬盘控制器
    ↓ 处理读写操作
物理磁盘
    ↓ 返回结果
应用程序接收数据
```

**🔸 核心概念解释**
- **IO请求**：应用程序要求读取或写入数据的指令
- **IO队列**：等待处理的读写请求排成的队伍
- **IO调度**：操作系统决定先处理哪个请求的策略

---

## 2. 📊 iostat命令详解


### 2.1 iostat是什么


**🎯 定义**
`iostat`是**IO统计工具**的缩写，专门用来分析硬盘的输入输出统计信息。

**💭 通俗理解**
就像是硬盘的"体检报告"，告诉你：
- 硬盘读写了多少数据
- 硬盘有多忙
- IO操作的效率如何

### 2.2 iostat基本用法


**🔧 基础语法**
```bash
iostat [选项] [间隔时间] [次数]
```

**⭐ 常用选项说明**

| 选项 | **含义** | **说明** |
|------|---------|----------|
| `-x` | `扩展显示` | 显示详细的IO统计信息 |
| `-d` | `仅显示设备` | 只显示磁盘设备统计 |
| `-k` | `以KB为单位` | 数据量以千字节显示 |
| `-m` | `以MB为单位` | 数据量以兆字节显示 |
| `-t` | `显示时间戳` | 在输出中包含时间信息 |

### 2.3 iostat输出详解


**📈 基本输出示例**
```bash
$ iostat -x 1 3
```

**输出内容解读**
```
Device  r/s    w/s   rkB/s   wkB/s  %util
sda    15.2   8.5   245.6   128.3   25.4
sdb     2.1   1.2    32.8    18.7    5.2
```

**🔸 各字段含义详解**

| 字段 | **中文名称** | **通俗解释** | **单位** |
|------|-------------|-------------|----------|
| `Device` | 设备名 | 硬盘的名字（如sda、sdb） | - |
| `r/s` | 每秒读次数 | 每秒钟读了多少次 | 次/秒 |
| `w/s` | 每秒写次数 | 每秒钟写了多少次 | 次/秒 |
| `rkB/s` | 每秒读千字节 | 每秒读了多少KB数据 | KB/s |
| `wkB/s` | 每秒写千字节 | 每秒写了多少KB数据 | KB/s |
| `%util` | 利用率 | 硬盘忙碌程度百分比 | % |

### 2.4 扩展模式重要指标


**🔍 使用 `iostat -x` 查看详细信息**
```
Device  rrqm/s wrqm/s  r/s   w/s  await  %util
sda       0.5    2.3  15.2  8.5   12.5   25.4
```

**🎯 关键指标深度解析**

**await（平均等待时间）**
```
含义：IO请求从发出到完成的平均时间
类比：就像排队买票，从开始排队到买到票的时间

正常值：
• 机械硬盘：< 20ms 正常，> 50ms 需要关注
• SSD硬盘：< 5ms 正常，> 10ms 需要关注
```

**%util（设备利用率）**
```
含义：硬盘在工作的时间占总时间的百分比
类比：就像员工的工作繁忙程度

判断标准：
• 0-50%：轻松工作
• 50-80%：比较忙碌  
• 80-100%：非常繁忙，可能需要优化
```

---

## 3. 🔍 iotop命令详解


### 3.1 iotop是什么


**🎯 定义**
`iotop`是一个实时显示进程IO使用情况的工具，类似于`top`命令，但专门针对磁盘IO。

**💭 通俗理解**
就像是IO使用的"排行榜"，实时显示：
- 哪个程序在大量读写硬盘
- 每个程序的IO使用量
- 系统总的IO负载情况

### 3.2 iotop基本使用


**🔧 安装iotop**
```bash
# CentOS/RHEL
sudo yum install iotop

# Ubuntu/Debian  
sudo apt-get install iotop
```

**⭐ 基本运行**
```bash
sudo iotop
```

### 3.3 iotop界面解读


**📊 输出界面示例**
```
Total DISK READ: 2.5 M/s | Total DISK WRITE: 1.2 M/s
  PID  PRIO  USER   DISK READ  DISK WRITE  COMMAND
 1234  be/4  mysql    1.8 M/s     0.5 M/s  mysqld
 5678  be/4  root     0.4 M/s     0.3 M/s  rsync
 9012  be/4  user     0.2 M/s     0.1 M/s  chrome
```

**🔸 界面元素说明**

**顶部统计信息**
- `Total DISK READ`：整个系统每秒读取的数据量
- `Total DISK WRITE`：整个系统每秒写入的数据量

**进程详细信息**

| 列名 | **含义** | **说明** |
|------|---------|----------|
| `PID` | 进程ID | 进程的唯一标识号 |
| `PRIO` | 优先级 | IO调度优先级 |
| `USER` | 用户 | 进程所属用户 |
| `DISK READ` | 读速度 | 该进程每秒读取的数据量 |
| `DISK WRITE` | 写速度 | 该进程每秒写入的数据量 |
| `COMMAND` | 命令 | 进程名称或命令 |

### 3.4 iotop常用操作


**⌨️ 交互式快捷键**

| 按键 | **功能** | **说明** |
|------|---------|----------|
| `o` | 只显示有IO的进程 | 过滤掉没有磁盘活动的进程 |
| `a` | 显示累积IO | 显示进程启动以来的总IO量 |
| `q` | 退出 | 退出iotop程序 |
| `r` | 反向排序 | 改变排序方向 |
| `→ ←` | 改变排序列 | 按不同列进行排序 |

---

## 4. 📈 IO性能指标深度解析


### 4.1 IOPS性能指标


**🔸 什么是IOPS**
IOPS = **I**nput/**O**utput **O**perations **P**er **S**econd（每秒输入输出操作数）

**💭 通俗理解**
```
生活类比：
IOPS就像餐厅服务员每分钟能端多少盘菜
• 不管菜多菜少，端一次就算一次操作
• IOPS高 = 硬盘处理请求的能力强
• 适合衡量小文件频繁读写的性能
```

**📊 不同设备的IOPS对比**

| 存储类型 | **随机读IOPS** | **随机写IOPS** | **特点** |
|----------|---------------|---------------|----------|
| 机械硬盘(HDD) | 100-200 | 100-200 | 受寻道时间限制 |
| SATA SSD | 30,000-50,000 | 20,000-40,000 | 性价比高 |
| NVMe SSD | 100,000-500,000 | 50,000-200,000 | 性能最强 |

### 4.2 吞吐量性能指标


**🔸 什么是吞吐量**
吞吐量指每秒钟能传输多少数据，通常用MB/s或GB/s表示。

**💭 理解区别**
```
IOPS vs 吞吐量：

IOPS（操作次数）：
🍎 每秒拿10次苹果，每次1个 = 10 IOPS
🍉 每秒拿2次西瓜，每次1个 = 2 IOPS  

吞吐量（数据量）：
🍎 10个苹果 × 0.2kg = 2kg/秒
🍉 2个西瓜 × 3kg = 6kg/秒

结论：西瓜的IOPS低但吞吐量高！
```

**⚡ 应用场景对比**

| 场景类型 | **关注指标** | **实例** |
|----------|-------------|----------|
| 数据库事务 | **IOPS** | 大量小的查询请求 |
| 视频编辑 | **吞吐量** | 处理大视频文件 |
| 网站访问 | **IOPS** | 频繁的小文件请求 |
| 文件备份 | **吞吐量** | 传输大量数据 |

### 4.3 IO等待时间分析


**🔸 等待时间的构成**
```
总等待时间 = 队列等待时间 + 硬件处理时间

队列等待：请求在操作系统中排队的时间
硬件处理：硬盘实际执行读写的时间
```

**⏱️ 等待时间参考标准**

**机械硬盘（HDD）**
```
• 优秀：< 10ms
• 正常：10-20ms  
• 一般：20-50ms
• 差：> 50ms
```

**固态硬盘（SSD）**
```
• 优秀：< 1ms
• 正常：1-5ms
• 一般：5-10ms  
• 差：> 10ms
```

### 4.4 磁盘繁忙度（%util）深度解析


**🔸 %util的真正含义**
很多人误解%util就是硬盘的使用率，实际上它表示的是：
> 硬盘在工作的时间占总时间的百分比

**💡 重要理解**
```
%util = 硬盘工作时间 / 总时间 × 100%

误区：%util = 100% 不代表硬盘完全饱和
真相：可能只是硬盘一直在处理请求，但处理能力还有余量

举例说明：
餐厅服务员一直在端菜（%util=100%）
但他可能还能端更多盘子（实际能力未饱和）
```

**🎯 正确解读%util**

| %util值 | **状态描述** | **建议** |
|---------|-------------|----------|
| 0-30% | 很空闲 | 硬盘资源充足 |
| 30-70% | 正常工作 | 可以接受的使用水平 |
| 70-90% | 比较繁忙 | 需要关注，考虑优化 |
| 90-100% | 非常繁忙 | **需要结合其他指标判断** |

---

## 5. 💿 磁盘类型与性能特征


### 5.1 机械硬盘（HDD）特性


**🔸 工作原理**
```
机械硬盘结构：
    磁盘盘片
       ↓
    磁头臂 ←→ 寻道（移动到正确磁道）
       ↓
    等待旋转 ←→ 旋转延迟（等待数据转到磁头下）
       ↓
    数据传输 ←→ 实际读写数据
```

**⚡ 性能特征**

**优点**
- ✅ **容量大**：单盘可达20TB以上
- ✅ **成本低**：每GB成本最便宜
- ✅ **顺序读写快**：大文件传输效率高

**缺点**
- ❌ **随机访问慢**：寻道时间是性能瓶颈
- ❌ **机械结构**：容易受震动影响
- ❌ **功耗较高**：马达和磁头需要持续供电

### 5.2 固态硬盘（SSD）特性


**🔸 工作原理**
```
SSD存储原理：
电子信号 → 闪存芯片 → 直接访问数据
（没有机械移动部件）
```

**⚡ 性能特征**

**优点**
- ✅ **随机访问快**：无寻道时间
- ✅ **延迟极低**：微秒级响应时间
- ✅ **抗震动**：无机械部件
- ✅ **功耗低**：无马达等机械结构

**缺点**
- ❌ **价格较高**：每GB成本比HDD高
- ❌ **写入寿命**：闪存有擦写次数限制
- ❌ **数据恢复难**：损坏后数据难以恢复

### 5.3 性能对比实例


**📊 实际性能数据对比**

| 性能指标 | **机械硬盘** | **SATA SSD** | **NVMe SSD** |
|----------|-------------|--------------|---------------|
| **随机读IOPS** | 100-200 | 30,000+ | 100,000+ |
| **随机写IOPS** | 100-200 | 20,000+ | 50,000+ |
| **顺序读速度** | 150MB/s | 550MB/s | 3,500MB/s |
| **顺序写速度** | 150MB/s | 500MB/s | 3,000MB/s |
| **平均延迟** | 5-10ms | 0.1ms | 0.05ms |

**🎯 选择建议**

```
机械硬盘适合：
📁 大容量存储（视频、备份）
💰 预算有限的场景
🗃️ 归档数据存储

SSD适合：  
⚡ 系统盘和应用程序
🎮 游戏加载
💻 需要快速响应的应用
🗄️ 数据库存储
```

---

## 6. 🔧 IO瓶颈识别与优化


### 6.1 IO瓶颈识别方法


**🎯 瓶颈识别流程图**
```
第一步：基础检查
    ↓ 使用 iostat -x 1
观察 %util 和 await
    ↓ 
%util > 80% 或 await > 20ms？
    ↓ Yes
第二步：深入分析  
    ↓ 使用 iotop
找出高IO使用的进程
    ↓
第三步：优化决策
确定优化方案
```

**🔸 关键判断指标**

| 指标 | **正常值** | **警告值** | **危险值** |
|------|-----------|-----------|-----------|
| `%util` | < 50% | 50-80% | > 80% |
| `await` | < 10ms | 10-30ms | > 30ms |
| `svctm` | < 5ms | 5-15ms | > 15ms |
| `avgqu-sz` | < 2 | 2-8 | > 8 |

### 6.2 常见IO瓶颈场景


**🚨 场景一：数据库负载过高**
```bash
# 典型表现
$ iostat -x 1
Device  %util  await  r/s   w/s
sda     95.2   45.6  156   289
```

**诊断**：`%util`接近100%，`await`过高
**原因**：数据库频繁读写，硬盘处理不过来
**解决方案**：
- 🔧 优化数据库查询
- 💾 增加内存缓存
- 💿 升级到SSD硬盘

**🚨 场景二：大文件备份**
```bash
# 典型表现  
$ iotop
Total DISK WRITE: 85.6 M/s
PID   USER  DISK WRITE  COMMAND
1234  root  85.2 M/s    rsync
```

**诊断**：单个进程占用大量写带宽
**原因**：备份操作消耗磁盘带宽
**解决方案**：
- ⏰ 调整备份时间到业务低峰期
- 🔄 限制备份进程IO优先级
- 📀 使用专门的备份磁盘

### 6.3 IO性能优化策略


**⚡ 硬件优化**

**存储升级路线**
```
机械硬盘 → SATA SSD → NVMe SSD

性能提升：
IOPS: 200 → 30,000 → 100,000
延迟: 10ms → 0.1ms → 0.05ms
```

**🔧 软件优化**

**IO调度器优化**
```bash
# 查看当前调度器
cat /sys/block/sda/queue/scheduler

# SSD推荐调度器
echo noop > /sys/block/sda/queue/scheduler

# 机械硬盘推荐调度器  
echo deadline > /sys/block/sda/queue/scheduler
```

**文件系统优化**
```bash
# ext4文件系统优化挂载参数
mount -o noatime,data=writeback /dev/sda1 /data

# XFS文件系统（大文件场景更好）
mkfs.xfs -f /dev/sda1
```

**📊 应用层优化**

**数据库优化**
- 🔍 优化慢查询SQL
- 📈 增加合适的索引
- 💾 调整缓冲区大小
- 🗂️ 分库分表降低单库压力

**应用程序优化**
- 📝 批量写入替代频繁小写入
- 🗃️ 使用异步IO
- 💿 读写分离架构
- 📚 合理使用缓存

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的关键概念


```
🔸 iostat：硬盘体检工具，看硬盘工作统计
🔸 iotop：IO排行榜工具，看谁在大量使用硬盘  
🔸 IOPS：每秒操作次数，衡量小文件处理能力
🔸 吞吐量：每秒传输数据量，衡量大文件处理能力
🔸 %util：硬盘工作时间比例，不等于性能饱和度
🔸 await：IO等待时间，反映硬盘响应速度
```

### 7.2 性能监控要点


**📊 日常监控关注点**
```
主要指标：
• %util > 80% → 硬盘很忙，需要关注
• await > 20ms → 响应慢，用户体验差  
• IOPS趋势 → 业务增长情况
• 吞吐量峰值 → 带宽使用情况

监控频率：
🔸 正常时期：每小时检查一次
🔸 业务高峰：每分钟检查一次
🔸 故障排查：实时监控
```

### 7.3 问题诊断思路


**🔍 标准诊断流程**
```
1️⃣ 发现问题：iostat发现异常指标
2️⃣ 定位进程：iotop找到罪魁祸首
3️⃣ 分析原因：结合业务场景判断
4️⃣ 制定方案：硬件/软件/应用优化
5️⃣ 验证效果：监控优化后的效果
```

### 7.4 硬盘选型建议


**💿 不同场景的选择策略**

| 应用场景 | **推荐硬盘** | **关注指标** | **预算考虑** |
|----------|-------------|-------------|-------------|
| **系统盘** | NVMe SSD | 随机IOPS | 优先性能 |
| **数据库** | SATA SSD | IOPS + 延迟 | 性能优先 |
| **大文件存储** | 机械硬盘 | 容量 + 成本 | 成本优先 |
| **备份归档** | 机械硬盘 | 容量 | 成本最优 |

### 7.5 实用命令速查


**⚡ 快速诊断命令组合**
```bash
# 快速查看IO状况
iostat -x 1 3

# 找出IO使用大户
sudo iotop -o

# 持续监控关键指标
watch -n 1 'iostat -x | head -10'

# 查看特定进程IO
pid=1234; cat /proc/$pid/io
```

**🎯 记忆要点**
- **iostat看整体**：硬盘总体健康状况
- **iotop看个体**：具体是谁在使用硬盘
- **%util看忙碌度**：硬盘工作时间占比
- **await看用户体验**：用户等待时间长短
- **IOPS看并发能力**：处理小文件的能力
- **吞吐量看传输能力**：处理大文件的速度

**核心记忆**：
> 硬盘监控三步走：iostat看概况，iotop找元凶，指标分析定方案