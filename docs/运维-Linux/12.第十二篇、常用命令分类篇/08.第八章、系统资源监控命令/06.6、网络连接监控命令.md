---
title: 6、网络连接监控命令
---
## 📚 目录

1. [网络连接监控概述](#1-网络连接监控概述)
2. [netstat传统网络状态工具](#2-netstat传统网络状态工具)
3. [ss现代网络统计利器](#3-ss现代网络统计利器)
4. [TCP连接状态深度解析](#4-tcp连接状态深度解析)
5. [端口占用与进程排查](#5-端口占用与进程排查)
6. [Unix域套接字监控](#6-unix域套接字监控)
7. [网络故障排查实战](#7-网络故障排查实战)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌐 网络连接监控概述


### 1.1 什么是网络连接监控


网络连接监控就像是给你的Linux系统装上了一双"透视眼"，让你能够清楚地看到：

**🔸 系统的网络活动情况**
- 哪些程序在使用网络
- 有多少网络连接正在活跃
- 哪些端口正在监听外部连接

**🔸 网络连接的详细状态**  
- 连接是建立成功的还是正在等待
- 数据传输是否正常
- 连接是否出现了问题

> 💡 **生活类比**  
> 就像交通监控中心可以看到所有道路的车辆流量一样，网络监控让你看到系统中所有的"数据流量"

### 1.2 为什么需要网络连接监控


**🔹 系统安全防护**
```
场景：发现异常网络连接
问题：是否有恶意程序在偷偷联网？
解决：通过监控及时发现可疑连接
```

**🔹 性能问题诊断**
```
场景：网站访问缓慢
问题：是否有太多连接占用资源？
解决：查看连接数量和状态分布
```

**🔹 服务状态检查**
```
场景：Web服务无法访问
问题：服务是否正在监听端口？
解决：检查端口监听状态
```

### 1.3 网络监控的核心对象


| 监控对象 | **作用说明** | **典型场景** |
|---------|------------|-------------|
| 🔸 **端口状态** | `查看哪些端口在监听` | `检查服务是否启动` |
| 🔸 **连接状态** | `了解连接的当前状态` | `诊断网络问题` |
| 🔸 **进程信息** | `找出占用端口的程序` | `排查端口冲突` |
| 🔸 **流量统计** | `查看数据传输情况` | `性能分析优化` |

---

## 2. 📊 netstat传统网络状态工具


### 2.1 netstat基础认知


`netstat`是Linux系统中的"网络状态老管家"，虽然年代久远但功能强大。

**🔸 核心作用**
- 显示网络连接信息
- 查看路由表
- 显示接口统计
- 监控网络协议使用情况

> 🧠 **记忆要点**  
> netstat = network statistics (网络统计)

### 2.2 netstat常用参数详解


**🔹 基础参数组合**

| 参数 | **含义** | **作用说明** |
|------|---------|-------------|
| `-t` | TCP连接 | 只显示TCP协议的连接 |
| `-u` | UDP连接 | 只显示UDP协议的连接 |
| `-l` | 监听状态 | 只显示正在监听的端口 |
| `-n` | 数字显示 | 用IP地址和端口号显示，不解析域名 |
| `-p` | 显示进程 | 显示占用端口的进程信息 |

**🔹 实用参数组合**

```bash
# 查看所有TCP连接
netstat -t

# 查看监听中的端口
netstat -tl

# 数字化显示，速度更快
netstat -tln

# 完整信息：TCP + 监听 + 数字 + 进程
netstat -tlnp
```

### 2.3 netstat输出解读


**🔸 输出格式说明**
```
Proto Recv-Q Send-Q Local Address    Foreign Address   State    PID/Program
tcp   0      0      0.0.0.0:22       0.0.0.0:*         LISTEN   1234/sshd
tcp   0      0      192.168.1.10:80  192.168.1.20:3456 ESTABLISHED 5678/nginx
```

**字段含义解释**：

| 字段 | **含义** | **说明** |
|------|---------|---------|
| `Proto` | 协议类型 | tcp、udp等 |
| `Recv-Q` | 接收队列 | 等待接收的字节数 |
| `Send-Q` | 发送队列 | 等待发送的字节数 |
| `Local Address` | 本地地址 | 本机IP:端口 |
| `Foreign Address` | 远程地址 | 对方IP:端口 |
| `State` | 连接状态 | LISTEN、ESTABLISHED等 |
| `PID/Program` | 进程信息 | 进程ID/程序名 |

### 2.4 netstat实用场景


**🔹 检查Web服务状态**
```bash
# 检查80端口是否在监听
netstat -tln | grep :80

# 查看nginx进程的网络连接
netstat -tlnp | grep nginx
```

**🔹 统计连接数量**
```bash
# 统计总连接数
netstat -t | wc -l

# 统计不同状态的连接数
netstat -t | grep ESTABLISHED | wc -l
netstat -t | grep TIME_WAIT | wc -l
```

**🔹 查找端口占用**
```bash
# 查看8080端口被谁占用
netstat -tlnp | grep :8080

# 查看所有监听端口
netstat -tln | grep LISTEN
```

---

## 3. ⚡ ss现代网络统计利器


### 3.1 ss工具优势认知


`ss`是新一代的网络统计工具，可以理解为netstat的"现代化升级版"。

**🔸 为什么选择ss？**

| 对比维度 | **netstat** | **ss** | **优势说明** |
|---------|------------|--------|-------------|
| 🔸 **执行速度** | `较慢` | `极快` | `ss直接读取内核信息` |
| 🔸 **功能丰富度** | `基础功能` | `功能丰富` | `更多过滤和统计选项` |
| 🔸 **输出格式** | `固定格式` | `灵活定制` | `支持JSON等多种输出` |
| 🔸 **维护状态** | `停止维护` | `持续更新` | `跟上现代Linux发展` |

> 💡 **升级建议**  
> 在现代Linux系统中，建议优先使用ss命令，netstat主要用于兼容性需求

### 3.2 ss基础语法掌握


**🔹 核心参数对比**

```bash
# netstat常用组合
netstat -tlnp

# 对应的ss命令
ss -tlnp
```

**🔹 ss独有的强大功能**

| 参数 | **作用** | **示例用法** |
|------|---------|-------------|
| `-4` | 只显示IPv4 | `ss -4 -tln` |
| `-6` | 只显示IPv6 | `ss -6 -tln` |
| `-s` | 显示统计摘要 | `ss -s` |
| `-i` | 显示详细信息 | `ss -i` |

### 3.3 ss高级过滤技巧


**🔹 按状态过滤**
```bash
# 只显示已建立的连接
ss -t state established

# 显示监听状态的连接
ss -t state listening

# 显示TIME-WAIT状态的连接
ss -t state time-wait
```

**🔹 按端口过滤**
```bash
# 显示特定端口的连接
ss -tln sport :80
ss -tln dport :3306

# 显示端口范围
ss -tln sport :1000-2000
```

**🔹 按进程过滤**
```bash
# 显示特定进程的连接
ss -tlnp | grep nginx
ss -tlnp | grep mysqld
```

### 3.4 ss实际应用案例


**🔹 系统网络概况查看**
```bash
# 快速查看网络统计摘要
ss -s
```

输出示例：
```
Total: 1245 (kernel 1876)
TCP:   423 (estab 234, closed 156, orphaned 2, synrecv 0, timewait 155/0)
UDP:   12 (mem 2)
```

**🔹 高并发服务监控**
```bash
# 监控Web服务器连接状态分布
ss -t state all | grep :80 | awk '{print $1}' | sort | uniq -c

# 查看MySQL连接情况
ss -tlnp | grep :3306
```

---

## 4. 🔄 TCP连接状态深度解析


### 4.1 TCP连接生命周期理解


TCP连接就像人与人之间的电话通话，有建立、通话、挂断等不同阶段。

**🔸 连接建立过程**
```
客户端          服务器
   |               |
   |--[SYN]------->|  (发起连接请求)
   |<--[SYN+ACK]---|  (同意建立连接)  
   |--[ACK]------->|  (确认连接建立)
   |               |
[ESTABLISHED]  [ESTABLISHED]  (连接成功建立)
```

### 4.2 TCP状态详细说明


| 状态名称 | **含义解释** | **出现场景** | **是否正常** |
|---------|-------------|-------------|-------------|
| 🟢 **LISTEN** | `服务正在监听端口` | `Web服务器等待连接` | `正常监听状态` |
| 🟢 **ESTABLISHED** | `连接已建立，正在通信` | `正常数据传输` | `活跃连接状态` |
| 🟡 **TIME_WAIT** | `连接关闭后的等待期` | `连接刚关闭完成` | `正常但需监控数量` |
| 🟡 **CLOSE_WAIT** | `等待应用程序关闭` | `对方关闭，本地未关闭` | `可能存在程序问题` |
| 🔴 **SYN_SENT** | `发送连接请求，等待响应` | `正在尝试连接对方` | `短暂状态，持续则异常` |
| 🔴 **SYN_RECV** | `收到连接请求，等待确认` | `服务器等待客户端确认` | `短暂状态，大量则可能被攻击` |

### 4.3 连接状态实际意义


**🔹 ESTABLISHED状态分析**
```bash
# 查看当前活跃连接数
ss -t state established | wc -l

# 按目标端口统计连接
ss -t state established | awk '{print $4}' | cut -d: -f2 | sort | uniq -c
```

> 💡 **性能指标**  
> ESTABLISHED连接数量反映了服务器的当前负载情况

**🔹 TIME_WAIT状态监控**
```bash
# 统计TIME_WAIT连接数
ss -t state time-wait | wc -l
```

> ⚠️ **注意事项**  
> TIME_WAIT连接过多可能导致端口耗尽，影响新连接建立

**🔹 CLOSE_WAIT状态排查**
```bash
# 查看CLOSE_WAIT连接
ss -t state close-wait -p
```

> 🚨 **问题信号**  
> CLOSE_WAIT状态堆积通常表示应用程序没有正确关闭连接

### 4.4 异常状态处理建议


**🔸 TIME_WAIT过多的解决**
```bash
# 查看系统TIME_WAIT设置
cat /proc/sys/net/ipv4/tcp_fin_timeout

# 临时调整（需要root权限）
echo 30 > /proc/sys/net/ipv4/tcp_fin_timeout
```

**🔸 连接数监控脚本**
```bash
#!/bin/bash
echo "=== TCP连接状态统计 ==="
ss -t state all | awk '{print $1}' | grep -v State | sort | uniq -c
```

---

## 5. 🔍 端口占用与进程排查


### 5.1 端口占用排查思路


当遇到"端口已被占用"的错误时，就需要找出到底是哪个程序占用了端口。

**🔸 排查步骤流程**
```
1. 确认端口被占用
     ↓
2. 找到占用端口的进程
     ↓  
3. 分析进程是否合理
     ↓
4. 决定是否终止进程
```

### 5.2 端口占用检查方法


**🔹 使用ss命令检查**
```bash
# 检查特定端口是否被占用
ss -tlnp | grep :8080

# 检查端口范围占用情况
ss -tlnp | grep -E ':(80|443|8080)'
```

**🔹 使用netstat检查**
```bash
# 传统方法检查端口占用
netstat -tlnp | grep :8080

# 查看所有监听端口及进程
netstat -tlnp | grep LISTEN
```

**🔹 使用lsof命令**
```bash
# 查看8080端口的占用情况
lsof -i :8080

# 查看特定进程打开的网络连接
lsof -p 1234 -a -i
```

### 5.3 进程与端口关联分析


**🔸 输出信息解读**
```bash
$ ss -tlnp | grep :80
LISTEN  0  128  *:80  *:*  users:(("nginx",pid=1234,fd=8))
```

**信息含义**：
- `nginx`：程序名称
- `pid=1234`：进程ID号
- `fd=8`：文件描述符号

**🔸 进程详细信息查看**
```bash
# 根据PID查看进程详情
ps -fp 1234

# 查看进程的启动命令
ps -o pid,ppid,cmd -p 1234

# 查看进程的工作目录
pwdx 1234
```

### 5.4 端口冲突解决策略


**🔹 识别合法进程**
```bash
# 检查进程启动用户
ps -o pid,user,cmd -p 1234

# 检查进程启动时间
ps -o pid,lstart,cmd -p 1234
```

**🔹 处理非法进程**
```bash
# 温和终止进程
kill 1234

# 强制终止进程（慎用）
kill -9 1234
```

> ⚠️ **安全提醒**  
> 终止进程前务必确认其身份，避免误杀系统关键进程

**🔹 端口释放验证**
```bash
# 终止进程后验证端口是否释放
ss -tlnp | grep :8080

# 如果端口仍被占用，等待片刻再检查
sleep 5 && ss -tlnp | grep :8080
```

---

## 6. 🔌 Unix域套接字监控


### 6.1 Unix域套接字概念理解


Unix域套接字是Linux系统内部进程通信的"专用通道"，不走网络，只在本机内部使用。

**🔸 与网络套接字的区别**

| 特征 | **网络套接字** | **Unix域套接字** |
|------|---------------|-----------------|
| 🔸 **通信范围** | `跨网络通信` | `本机内部通信` |
| 🔸 **地址格式** | `IP地址:端口号` | `文件路径` |
| 🔸 **性能特点** | `受网络影响` | `性能极高` |
| 🔸 **安全性** | `需要网络安全` | `文件系统权限控制` |

**🔸 常见应用场景**
- 数据库客户端与服务器通信（如MySQL的.sock文件）
- Web服务器与后端应用通信（如Nginx + PHP-FPM）
- 系统服务间的内部通信

### 6.2 Unix套接字监控方法


**🔹 使用ss查看Unix套接字**
```bash
# 显示所有Unix域套接字
ss -x

# 显示监听状态的Unix套接字
ss -xl

# 显示连接状态的Unix套接字
ss -x state connected
```

**🔹 使用netstat查看**
```bash
# 显示Unix域套接字
netstat -x

# 显示监听状态的Unix套接字
netstat -xl
```

### 6.3 Unix套接字输出解读


**🔸 典型输出示例**
```bash
$ ss -xl
Netid State  Recv-Q Send-Q Local Address:Port
u_str LISTEN 0      128    /var/run/mysqld/mysqld.sock 12345
u_str LISTEN 0      128    /run/php/php7.4-fpm.sock 67890
```

**字段说明**：
- `u_str`：Unix流套接字类型
- `LISTEN`：监听状态
- 路径：套接字文件的完整路径
- 数字：inode号码

### 6.4 Unix套接字实际应用


**🔹 MySQL套接字监控**
```bash
# 查看MySQL Unix套接字
ss -xl | grep mysql

# 检查套接字文件权限
ls -la /var/run/mysqld/mysqld.sock
```

**🔹 PHP-FPM套接字监控**
```bash
# 查看PHP-FPM套接字状态
ss -xl | grep php

# 验证套接字连接性
echo "test" | socat - /run/php/php7.4-fpm.sock
```

---

## 7. 🛠️ 网络故障排查实战


### 7.1 常见网络故障类型


**🔸 服务无法访问**
```
现象：浏览器显示"连接被拒绝"
原因：服务未启动或端口未监听
排查：检查端口监听状态
```

**🔸 连接建立缓慢**
```
现象：网站打开很慢
原因：连接数过多或资源不足
排查：分析连接状态分布
```

**🔸 连接异常中断**
```
现象：连接突然断开
原因：网络不稳定或程序异常
排查：查看连接状态变化
```

### 7.2 系统化排查流程


**🔹 第一步：基础连通性检查**
```bash
# 检查服务是否监听目标端口
ss -tlnp | grep :80

# 检查本地连接是否正常
telnet localhost 80
```

**🔹 第二步：连接状态分析**
```bash
# 统计各种连接状态数量
ss -t state all | awk '{print $1}' | sort | uniq -c

# 重点关注异常状态
ss -t state close-wait -p
ss -t state syn-sent -p
```

**🔹 第三步：资源使用分析**
```bash
# 查看连接数是否过多
ss -t | wc -l

# 检查TIME_WAIT连接数量
ss -t state time-wait | wc -l
```

### 7.3 故障排查实战案例


**🔹 案例1：Web服务无法访问**

**故障现象**：用户反馈网站无法打开

**排查步骤**：
```bash
# 1. 检查Web服务是否监听80端口
$ ss -tlnp | grep :80
(无输出，说明80端口没有监听)

# 2. 检查Web服务进程状态
$ ps aux | grep nginx
(发现nginx进程不存在)

# 3. 启动Web服务
$ systemctl start nginx

# 4. 验证修复结果
$ ss -tlnp | grep :80
LISTEN 0 128 *:80 *:* users:(("nginx",pid=1234,fd=6))
```

**🔹 案例2：数据库连接数过多**

**故障现象**：应用报错"Too many connections"

**排查步骤**：
```bash
# 1. 检查MySQL连接数
$ ss -t | grep :3306 | wc -l
156

# 2. 查看连接状态分布
$ ss -t | grep :3306 | awk '{print $1}' | sort | uniq -c
   145 ESTABLISHED
    8 TIME_WAIT
    3 CLOSE_WAIT

# 3. 查看具体连接来源
$ ss -tnp | grep :3306 | head -10

# 4. 分析是否有连接泄露
$ ss -t state close-wait | grep :3306
```

### 7.4 监控脚本编写


**🔹 网络连接监控脚本**
```bash
#!/bin/bash
# 网络连接状态监控脚本

echo "=== 网络连接监控报告 $(date) ==="
echo

echo "1. 端口监听状态："
ss -tlnp | grep LISTEN | awk '{print $4}' | sort -n

echo -e "\n2. TCP连接状态统计："
ss -t state all | awk '{print $1}' | grep -v State | sort | uniq -c

echo -e "\n3. 高连接数端口TOP5："
ss -t state established | awk '{print $4}' | cut -d: -f2 | sort | uniq -c | sort -nr | head -5

echo -e "\n4. TIME_WAIT连接数："
ss -t state time-wait | wc -l
```

---

## 8. 📋 核心要点总结


### 8.1 工具选择建议


**🔸 日常使用推荐**
- ✅ **ss命令**：现代Linux系统首选，速度快、功能强
- ⚖️ **netstat命令**：兼容性好，适合老系统或特定需求
- 🔧 **lsof命令**：文件和网络综合排查，功能互补

**🔸 具体场景选择**

| 使用场景 | **推荐工具** | **命令示例** |
|---------|------------|-------------|
| 🔸 **快速查看监听端口** | `ss` | `ss -tlnp` |
| 🔸 **详细连接状态分析** | `ss` | `ss -i state established` |
| 🔸 **端口占用排查** | `ss + lsof` | `ss -tlnp \| grep :port` |
| 🔸 **兼容性需求** | `netstat` | `netstat -tlnp` |

### 8.2 核心命令记忆


**🔹 必记命令组合**
```bash
# 查看监听端口（ss版本）
ss -tlnp

# 查看监听端口（netstat版本）  
netstat -tlnp

# 连接状态统计
ss -t state all | awk '{print $1}' | sort | uniq -c

# 端口占用检查
ss -tlnp | grep :端口号
```

**🔹 参数含义记忆**
- `t` = TCP连接
- `l` = Listen监听状态  
- `n` = Numeric数字显示
- `p` = Process进程信息

> 🧠 **记忆口诀**  
> "TCP监听数字进程" = tlnp

### 8.3 TCP状态理解要点


**🔸 正常状态**
- 🟢 **LISTEN**：服务正常监听，等待连接
- 🟢 **ESTABLISHED**：连接正常，数据传输中

**🔸 需要关注的状态** 
- 🟡 **TIME_WAIT**：正常关闭状态，数量过多需优化
- 🔴 **CLOSE_WAIT**：可能存在程序bug，需要排查

**🔸 异常状态**
- 🔴 **SYN_SENT/SYN_RECV**：持续存在表示连接问题

### 8.4 故障排查思路


**🔹 系统化排查步骤**
```
1. 确认故障现象
   ↓
2. 检查端口监听状态
   ↓  
3. 分析连接状态分布
   ↓
4. 查找异常进程或连接
   ↓
5. 验证修复结果
```

**🔹 排查工具使用顺序**
1. **ss/netstat**：查看网络连接全局状况
2. **lsof**：详细分析特定端口或进程
3. **ps**：确认进程状态和启动信息
4. **systemctl**：检查和控制系统服务

### 8.5 实际应用价值


**🎯 系统管理员**
- 快速诊断网络服务故障
- 监控系统网络资源使用情况
- 及时发现异常网络连接

**🎯 开发人员**  
- 调试网络应用程序
- 排查端口冲突问题
- 优化应用网络性能

**🎯 安全工程师**
- 发现可疑网络连接
- 监控网络安全状态
- 分析网络攻击行为

---

**🎓 学习检查清单**

- [ ] 能够使用ss和netstat查看网络连接状态
- [ ] 理解TCP各种连接状态的含义
- [ ] 掌握端口占用问题的排查方法  
- [ ] 了解Unix域套接字的监控方式
- [ ] 能够进行基本的网络故障排查
- [ ] 可以编写简单的网络监控脚本

**核心记忆**：
网络监控双工具，ss快速netstat全  
端口监听tlnp查，进程占用一目然  
TCP状态要理解，异常排查有章法  
故障诊断分步骤，工具组合效果佳