---
title: 6、文本排序与去重命令
---
## 📚 目录

1. [文本排序与去重概述](#1-文本排序与去重概述)
2. [sort排序命令详解](#2-sort排序命令详解)
3. [uniq去重命令详解](#3-uniq去重命令详解)
4. [高级排序与去重技巧](#4-高级排序与去重技巧)
5. [性能优化与大文件处理](#5-性能优化与大文件处理)
6. [核心要点总结](#6-核心要点总结)

---

## 1. 📊 文本排序与去重概述


### 1.1 为什么需要排序与去重


**生活中的类比**：
> 💭 **生活类比**：就像整理书架一样
> - 排序：按书名字母顺序排列，方便查找
> - 去重：把重复买的书挑出来，避免浪费空间

**实际应用场景**：
- **日志分析**：对访问日志按时间排序，统计独立IP数量
- **数据清理**：去除重复记录，按特定字段排序
- **系统管理**：整理用户列表，统计系统资源使用情况

### 1.2 核心概念理解


**排序的本质**：
```
原始数据（无序）     →     排序后（有序）
apple                      apple
zebra                      banana  
banana              →      orange
orange                     zebra
apple                      （重复的apple）
```

**去重的作用**：
```
排序后数据          →     去重后数据
apple                      apple
apple               →      banana
banana                     orange
orange                     zebra
zebra
```

> **💡 关键理解**：排序和去重通常配合使用，先排序让相同内容相邻，再去重效率更高

---

## 2. 🔄 sort排序命令详解


### 2.1 sort基本排序功能


**基础语法结构**：
```bash
sort [选项] [文件名...]
```

**最简单的排序示例**：
```bash
# 创建测试文件
echo -e "zebra\napple\nbanana\norange" > fruits.txt

# 基本排序（按字母顺序）
sort fruits.txt
# 输出：
# apple
# banana  
# orange
# zebra
```

> **📌 重要提醒**：sort默认按ASCII码值排序，这意味着大写字母会排在小写字母前面

### 2.2 数值排序与字母排序


**字母排序 vs 数值排序的区别**：

**字母排序（默认）**：
```bash
echo -e "100\n20\n3" > numbers.txt
sort numbers.txt
# 输出：100, 20, 3（按字符比较）
```

**数值排序**：
```bash
sort -n numbers.txt
# 输出：3, 20, 100（按数值大小比较）
```

> **💭 生活类比**：就像图书馆编号，"2"和"10"按字符排序是2在10前面，但按数值排序应该是2在10前面

**常用排序选项对比**：

| 选项 | 含义 | 适用场景 | 示例 |
|------|------|----------|------|
| `默认` | **字母排序** | `文本内容排序` | `按用户名排序` |
| `-n` | **数值排序** | `数字数据排序` | `按年龄、分数排序` |
| `-r` | **逆序排序** | `倒序显示结果` | `从大到小排序` |
| `-f` | **忽略大小写** | `不区分大小写排序` | `用户输入数据` |

### 2.3 多字段排序规则


**理解多字段排序**：
> **💭 生活类比**：学生成绩排序 - 先按总分排序，总分相同的再按语文分数排序

**实际例子**：
```bash
# 创建学生成绩文件（格式：姓名 总分 语文分）
cat > scores.txt << EOF
张三 85 78
李四 90 82
王五 85 85
赵六 90 80
EOF

# 按总分排序（第2列），总分相同按语文分排序（第3列）
sort -k2,2nr -k3,3nr scores.txt
# 输出：
# 李四 90 82
# 赵六 90 80  
# 王五 85 85
# 张三 85 78
```

**字段排序选项详解**：
```bash
-k2,2nr 解释：
-k2,2   # 指定第2个字段
n       # 数值排序
r       # 逆序排序
```

### 2.4 逆序排序选项


**正序 vs 逆序对比**：
```bash
# 正序排序（默认）
sort -n numbers.txt
# 3, 20, 100

# 逆序排序
sort -nr numbers.txt  
# 100, 20, 3
```

**实用场景**：
- **查找最大值**：`sort -nr file.txt | head -1`
- **查找最小值**：`sort -n file.txt | head -1`
- **Top 10排行**：`sort -nr scores.txt | head -10`

---

## 3. 🔍 uniq去重命令详解


### 3.1 uniq去重基本功能


**重要前提条件**：
> **⚠️ 重要提醒**：uniq只能去除**相邻**的重复行，所以通常需要先用sort排序

**基本使用示例**：
```bash
# 创建有重复内容的文件
cat > duplicate.txt << EOF
apple
banana
apple
orange
banana
apple
EOF

# 直接使用uniq（只去除相邻重复）
uniq duplicate.txt
# 输出：apple, banana, apple, orange, banana, apple（没变化）

# 先排序再去重
sort duplicate.txt | uniq
# 输出：apple, banana, orange（去重成功）
```

### 3.2 uniq统计功能


**统计重复次数**：
```bash
# 统计每行出现次数
sort duplicate.txt | uniq -c
# 输出：
#    3 apple
#    2 banana  
#    1 orange

# 只显示重复的行
sort duplicate.txt | uniq -d
# 输出：apple, banana

# 只显示不重复的行
sort duplicate.txt | uniq -u
# 输出：orange
```

**uniq常用选项总结**：

| 选项 | 功能说明 | 使用场景 |
|------|----------|----------|
| `默认` | **去除相邻重复行** | `基本去重` |
| `-c` | **统计每行出现次数** | `频率统计` |
| `-d` | **只显示重复的行** | `查找重复数据` |
| `-u` | **只显示唯一的行** | `查找非重复数据` |

### 3.3 实际应用案例


**网站访问日志分析**：
```bash
# 模拟访问日志（IP地址）
cat > access.log << EOF
192.168.1.1
192.168.1.2
192.168.1.1
192.168.1.3
192.168.1.2
192.168.1.1
EOF

# 统计独立访客数量
sort access.log | uniq | wc -l
# 输出：3（有3个不同IP）

# 统计每个IP访问次数
sort access.log | uniq -c | sort -nr
# 输出：
#    3 192.168.1.1
#    2 192.168.1.2
#    1 192.168.1.3
```

---

## 4. 🎯 高级排序与去重技巧


### 4.1 sort稳定性排序


**什么是稳定排序**：
> **💭 生活类比**：班级按成绩排序时，相同分数的学生保持原来的座位顺序不变

**稳定排序的重要性**：
```bash
# 创建测试数据（姓名 分数 班级）
cat > students.txt << EOF
张三 85 1班
李四 90 2班
王五 85 2班
赵六 90 1班
EOF

# 稳定排序：先按班级排序，再按分数排序
sort -k3 students.txt | sort -s -k2nr
# -s选项确保稳定性，相同分数的学生维持班级排序
```

### 4.2 临时文件与内存控制


**大文件排序的内存管理**：
> **💡 关键理解**：sort处理大文件时会使用临时文件，可以通过参数控制内存使用

**内存控制选项**：
```bash
# 限制内存使用（适合小内存环境）
sort -S 100M largefile.txt

# 指定临时目录
sort -T /tmp largefile.txt

# 并行排序（多核CPU优化）
sort --parallel=4 largefile.txt
```

### 4.3 组合命令技巧


**常用组合模式**：

**🔸 排序+去重+统计**：
```bash
# 统计文件中不重复行的数量
sort file.txt | uniq | wc -l

# 找出重复最多的内容
sort file.txt | uniq -c | sort -nr | head -5
```

**🔸 多文件处理**：
```bash
# 合并多个文件并去重
sort file1.txt file2.txt file3.txt | uniq

# 找出两个文件的共同内容
sort file1.txt file2.txt | uniq -d
```

---

## 5. ⚡ 性能优化与大文件处理


### 5.1 大文件排序优化


**内存与磁盘的权衡**：
```
小文件（<100MB）：全内存排序，速度最快
中文件（100MB-1GB）：部分临时文件，平衡性能
大文件（>1GB）：多临时文件，节省内存
```

**优化策略对比**：

| 场景 | 优化方法 | 命令示例 | 适用情况 |
|------|----------|----------|----------|
| **小文件** | `增加内存缓冲` | `sort -S 500M` | `内存充足` |
| **大文件** | `并行处理` | `sort --parallel=4` | `多核CPU` |
| **超大文件** | `外部排序` | `sort -T /fastdisk` | `磁盘空间大` |
| **网络文件** | `本地临时目录` | `sort -T /local/tmp` | `网络存储慢` |

### 5.2 性能监控与调优


**监控排序性能**：
```bash
# 显示排序进度和统计信息
time sort -S 200M --parallel=2 largefile.txt > sorted.txt

# 监控磁盘IO和内存使用
iostat -x 1 &  # 监控磁盘
sort largefile.txt &
```

**调优参考指标**：
- **内存使用**：设置合适的-S参数，避免系统交换
- **CPU利用**：使用--parallel参数充分利用多核
- **磁盘IO**：选择快速磁盘作为临时目录
- **网络延迟**：大文件先复制到本地再处理

---

## 6. 📋 核心要点总结


### 6.1 必须掌握的基本概念


```
🔸 sort基本功能：按字符或数值对文本行排序
🔸 uniq去重原理：只能去除相邻重复行，需配合sort使用
🔸 排序类型区别：字符排序vs数值排序的重要差异
🔸 多字段排序：指定多个排序条件的组合使用
🔸 稳定性概念：相同元素保持原有相对位置
```

### 6.2 关键命令选项记忆


**🧠 记忆技巧**：
```
sort记忆口诀：
- n代表number（数值排序）
- r代表reverse（逆序排序）  
- k代表key（指定字段）
- f代表fold（忽略大小写）

uniq记忆口诀：
- c代表count（统计次数）
- d代表duplicate（重复行）
- u代表unique（唯一行）
```

### 6.3 实际应用价值


**📊 典型应用场景**：
- **系统管理**：整理日志文件，统计系统资源使用
- **数据分析**：处理CSV文件，统计频率分布
- **开发调试**：分析程序输出，查找异常信息
- **运维监控**：处理监控数据，生成报告

**🎯 性能优化要点**：
- 大文件优先考虑内存设置和并行处理
- 选择合适的临时目录提升IO性能
- 根据数据特点选择合适的排序算法
- 监控系统资源使用，避免影响其他进程

### 6.4 常见错误与避免


**⚠️ 新手常犯错误**：
1. **直接用uniq不排序**：导致去重不完全
2. **数值按字符排序**：忘记使用-n选项
3. **大文件不控制内存**：导致系统卡顿
4. **多字段排序语法错误**：-k参数使用不当

**✅ 最佳实践建议**：
- 处理数字数据记住使用`-n`选项
- 去重前总是先用`sort`排序
- 大文件处理设置合适的内存限制
- 复杂排序先在小文件上测试语法

**核心记忆**：
- sort排序让数据有序，uniq去重让数据唯一
- 数字用-n，逆序用-r，字段用-k，统计用uniq -c
- 大文件记得控制内存，多核记得用parallel
- 先排序再去重，效果最佳性能优