---
title: 4、路由表管理命令
---
## 📚 目录

1. [路由表基础概念](#1-路由表基础概念)
2. [route命令详解](#2-route命令详解)
3. [ip route现代路由管理](#3-ip-route现代路由管理)
4. [routel路由表格式化显示](#4-routel路由表格式化显示)
5. [ARP表管理](#5-ARP表管理)
6. [邻居表管理](#6-邻居表管理)
7. [iptables路由规则](#7-iptables路由规则)
8. [默认网关配置](#8-默认网关配置)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🌐 路由表基础概念


### 1.1 什么是路由表


**路由表就像是网络世界的地图导航**。想象你要从家里去商场，需要知道走哪条路最合适。路由表就是告诉数据包"该往哪个方向走"的指路牌。

**路由表的核心作用**：
```
当数据包要发送到目标地址时：
1. 查看路由表找到最匹配的路径
2. 将数据包转发到下一跳地址
3. 如果没有匹配的路由，使用默认网关
```

### 1.2 路由表的基本组成


```
典型的路由表包含这些信息：

目标网络        下一跳         接口      度量值
192.168.1.0/24  0.0.0.0       eth0      0
10.0.0.0/8      192.168.1.1   eth0      1  
0.0.0.0/0       192.168.1.1   eth0      0
```

**字段含义解释**：
- **目标网络**：要到达的目标地址段
- **下一跳**：数据包的下一个转发地址
- **接口**：使用哪个网卡发送数据
- **度量值**：路径的优先级（数字越小优先级越高）

### 1.3 路由决策过程


```
数据包路由决策流程：

发送数据包 → 查看目标IP → 匹配路由表
     ↓
找到最具体的匹配项（最长前缀匹配）
     ↓
转发到对应的下一跳地址
     ↓
如果没有匹配项，使用默认路由
```

---

## 2. 🛣️ route命令详解


### 2.1 route命令基本用法


`route`命令是传统的路由表管理工具，虽然比较老旧，但在很多系统中仍然可用。

**查看当前路由表**：
```bash
# 显示路由表
route -n

# 显示详细路由信息
route -v
```

**为什么用-n参数**：
- `-n`参数显示数字形式的IP地址
- 不加`-n`会尝试解析主机名，速度较慢
- 数字形式更直观，便于理解

### 2.2 route命令查看路由表


```bash
# 基本路由表查看
route -n
```

**输出结果解释**：
```
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.1.1     0.0.0.0         UG    100    0        0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0
```

**各列含义**：
- **Destination**：目标网络地址
- **Gateway**：网关地址（0.0.0.0表示直接连接）
- **Genmask**：子网掩码
- **Flags**：路由标记
  - `U`：路由可用（Up）
  - `G`：通过网关（Gateway）
  - `H`：主机路由（Host）
- **Metric**：路由度量值（优先级）
- **Iface**：网络接口

### 2.3 route命令添加路由


```bash
# 添加网络路由
route add -net 10.0.0.0 netmask 255.0.0.0 gw 192.168.1.1

# 添加主机路由
route add -host 8.8.8.8 gw 192.168.1.1

# 添加默认路由
route add default gw 192.168.1.1
```

**参数说明**：
- `-net`：指定网络路由
- `-host`：指定主机路由
- `netmask`：子网掩码
- `gw`：网关地址
- `default`：默认路由（相当于0.0.0.0/0）

### 2.4 route命令删除路由


```bash
# 删除网络路由
route del -net 10.0.0.0 netmask 255.0.0.0

# 删除主机路由
route del -host 8.8.8.8

# 删除默认路由
route del default
```

---

## 3. 🚀 ip route现代路由管理


### 3.1 为什么推荐使用ip route


`ip route`是现代Linux系统推荐的路由管理工具，相比`route`命令有以下优势：
- **功能更全面**：支持更多的路由类型和参数
- **语法更一致**：与其他`ip`命令保持一致的语法风格
- **性能更好**：直接与内核通信，效率更高
- **持续维护**：`route`命令已经不再积极维护

### 3.2 ip route查看路由表


```bash
# 显示路由表
ip route show

# 简化形式
ip route

# 显示特定网络的路由
ip route show 192.168.1.0/24

# 显示默认路由
ip route show default
```

**输出格式解释**：
```
default via 192.168.1.1 dev eth0 proto dhcp metric 100
192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.100 metric 100
```

**字段含义**：
- **default**：默认路由
- **via**：通过哪个网关
- **dev**：使用哪个网络接口
- **proto**：路由协议来源（kernel、dhcp、static等）
- **scope**：路由作用域（global、link、host）
- **src**：源地址
- **metric**：路由优先级

### 3.3 ip route添加路由


**添加基本路由**：
```bash
# 添加网络路由
ip route add 10.0.0.0/8 via 192.168.1.1

# 添加主机路由
ip route add 8.8.8.8/32 via 192.168.1.1

# 添加默认路由
ip route add default via 192.168.1.1
```

**添加高级路由**：
```bash
# 指定网络接口
ip route add 172.16.0.0/16 via 192.168.1.1 dev eth0

# 设置路由优先级
ip route add 10.0.0.0/8 via 192.168.1.1 metric 10

# 添加多路径路由（负载均衡）
ip route add default nexthop via 192.168.1.1 weight 1 nexthop via 192.168.1.2 weight 1
```

### 3.4 ip route删除路由


```bash
# 删除特定路由
ip route del 10.0.0.0/8 via 192.168.1.1

# 删除默认路由
ip route del default

# 删除所有通过特定网关的路由
ip route flush via 192.168.1.1
```

### 3.5 路由表查询和测试


```bash
# 查看到特定目标的路由路径
ip route get 8.8.8.8

# 查看路由缓存
ip route show cache

# 清空路由缓存
ip route flush cache
```

---

## 4. 📋 routel路由表格式化显示


### 4.1 routel命令介绍


`routel`是一个专门用于格式化显示路由表的工具，它将路由信息以更易读的表格形式展示。

```bash
# 显示格式化的路由表
routel

# 显示IPv6路由表
routel ipv6
```

### 4.2 routel输出格式


```
         target            gateway          source    proto    scope    dev tbl
        default        192.168.1.1                   dhcp              eth0   
    192.168.1.0/ 24                   192.168.1.100   kernel     link    eth0   
    192.168.1.100               192.168.1.100   kernel     host    eth0   
```

**优势**：
- **对齐显示**：各列整齐对齐，易于阅读
- **完整信息**：显示所有重要的路由参数
- **直观理解**：表格格式便于比较不同路由

---

## 5. 🔍 ARP表管理


### 5.1 什么是ARP表


**ARP（地址解析协议）**的作用就像是"IP地址到MAC地址的电话簿"。

```
为什么需要ARP：
IP地址 → 逻辑地址，用于网络层路由
MAC地址 → 物理地址，用于数据链路层传输

ARP的作用：将IP地址解析为MAC地址
```

### 5.2 arp命令基本用法


```bash
# 显示ARP表
arp -a

# 显示数字形式的ARP表
arp -n

# 显示特定主机的ARP条目
arp 192.168.1.1
```

**ARP表输出解释**：
```
? (192.168.1.1) at 00:11:22:33:44:55 [ether] on eth0
? (192.168.1.100) at 00:aa:bb:cc:dd:ee [ether] on eth0
```

**字段含义**：
- **IP地址**：目标主机的IP地址
- **MAC地址**：对应的物理地址
- **[ether]**：接口类型（以太网）
- **网络接口**：使用的网卡

### 5.3 ARP表管理操作


**手动添加ARP条目**：
```bash
# 添加静态ARP条目
arp -s 192.168.1.10 00:11:22:33:44:55

# 删除ARP条目
arp -d 192.168.1.10

# 清空所有ARP条目
arp -d -a
```

**ARP故障排除**：
```bash
# 检查特定主机的ARP解析
ping 192.168.1.1
arp -n | grep 192.168.1.1

# 强制ARP解析
arp -d 192.168.1.1  # 删除旧条目
ping 192.168.1.1    # 触发新的ARP解析
```

---

## 6. 🏘️ 邻居表管理


### 6.1 ip neigh命令介绍


`ip neigh`是现代Linux系统中管理邻居表（相当于ARP表的升级版）的工具。它不仅支持IPv4的ARP，还支持IPv6的邻居发现协议。

### 6.2 查看邻居表


```bash
# 显示所有邻居条目
ip neigh show

# 简化形式
ip neigh

# 显示特定接口的邻居
ip neigh show dev eth0

# 显示特定IP的邻居信息
ip neigh show 192.168.1.1
```

**输出格式解释**：
```
192.168.1.1 dev eth0 lladdr 00:11:22:33:44:55 REACHABLE
192.168.1.2 dev eth0  FAILED
192.168.1.3 dev eth0 lladdr 00:aa:bb:cc:dd:ee STALE
```

**邻居状态含义**：
- **REACHABLE**：可达，地址解析成功且仍然有效
- **STALE**：过时，需要重新验证
- **FAILED**：失败，地址解析失败
- **INCOMPLETE**：不完整，正在进行地址解析

### 6.3 邻居表管理操作


```bash
# 添加静态邻居条目
ip neigh add 192.168.1.10 lladdr 00:11:22:33:44:55 dev eth0

# 修改邻居条目
ip neigh change 192.168.1.10 lladdr 00:11:22:33:44:66 dev eth0

# 删除邻居条目
ip neigh del 192.168.1.10 dev eth0

# 清空邻居表
ip neigh flush all
```

---

## 7. 🛡️ iptables路由规则


### 7.1 iptables与路由的关系


**iptables不是严格意义上的路由工具**，但它可以通过防火墙规则影响数据包的路由行为。

```
iptables在路由中的作用：
1. 数据包过滤 → 决定哪些包可以通过
2. NAT转换 → 改变源/目标地址
3. 数据包标记 → 影响路由决策
4. 重定向 → 改变数据包的转发目标
```

### 7.2 基本的路由相关iptables规则


**启用IP转发**：
```bash
# 临时启用IP转发
echo 1 > /proc/sys/net/ipv4/ip_forward

# 永久启用（编辑/etc/sysctl.conf）
net.ipv4.ip_forward = 1
```

**基本NAT规则**：
```bash
# SNAT：修改源地址（用于内网访问外网）
iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE

# DNAT：修改目标地址（用于端口转发）
iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.10:8080
```

### 7.3 路由相关的实用iptables规则


**数据包转发控制**：
```bash
# 允许特定网络的数据包转发
iptables -A FORWARD -s 192.168.1.0/24 -j ACCEPT

# 阻止特定目标的访问
iptables -A FORWARD -d 10.0.0.0/8 -j DROP
```

---

## 8. 🚪 默认网关配置


### 8.1 什么是默认网关


**默认网关就像是小区的大门**，当你要访问小区外的地方时，必须通过大门出去。

```
默认网关的作用：
当数据包的目标地址不在本地网络时
→ 将数据包发送给默认网关
→ 由网关负责进一步转发
```

### 8.2 查看当前默认网关


```bash
# 使用route命令
route -n | grep "^0.0.0.0"

# 使用ip route命令
ip route show default

# 更简单的方法
ip route | grep default
```

### 8.3 修改默认网关


**临时修改**：
```bash
# 删除原有默认网关
ip route del default

# 添加新的默认网关
ip route add default via 192.168.1.1
```

**永久修改**：

在不同的Linux发行版中，永久配置方法略有不同：

**CentOS/RHEL系统**：
```bash
# 编辑网络配置文件
vi /etc/sysconfig/network-scripts/ifcfg-eth0

# 添加或修改以下行
GATEWAY=192.168.1.1
```

**Ubuntu/Debian系统**：
```bash
# 编辑网络配置（较新版本使用netplan）
vi /etc/netplan/01-network-manager-all.yaml

# 配置示例
network:
  version: 2
  ethernets:
    eth0:
      dhcp4: no
      addresses: [192.168.1.100/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
```

### 8.4 多网关配置


**配置多个默认网关**（按优先级）：
```bash
# 添加主网关（优先级高，metric值小）
ip route add default via 192.168.1.1 metric 10

# 添加备用网关（优先级低，metric值大）  
ip route add default via 192.168.1.2 metric 20
```

---

## 9. 📋 核心要点总结


### 9.1 命令对比总结


| **功能** | **传统命令** | **现代命令** | **推荐使用** |
|---------|------------|------------|------------|
| **查看路由** | `route -n` | `ip route show` | ip route |
| **添加路由** | `route add` | `ip route add` | ip route |
| **查看ARP** | `arp -n` | `ip neigh show` | ip neigh |
| **格式化显示** | 无 | `routel` | routel |

### 9.2 常用命令速查


**路由表管理**：
```bash
# 查看路由表
ip route show

# 添加路由
ip route add 10.0.0.0/8 via 192.168.1.1

# 删除路由
ip route del 10.0.0.0/8

# 修改默认网关
ip route change default via 192.168.1.1
```

**ARP/邻居表管理**：
```bash
# 查看邻居表
ip neigh show

# 清空邻居表
ip neigh flush all

# 测试路由路径
ip route get 8.8.8.8
```

### 9.3 实际应用建议


**🎯 新手学习路径**：
1. **先理解概念**：路由表、ARP表的作用和原理
2. **掌握查看命令**：学会查看当前网络配置
3. **练习基本操作**：添加、删除简单的路由规则
4. **解决实际问题**：结合网络故障排除实践

**⚠️ 使用注意事项**：
- **备份配置**：修改网络配置前先备份
- **测试环境**：重要配置先在测试环境验证
- **权限要求**：大部分路由管理命令需要root权限
- **配置持久性**：区分临时配置和永久配置

**🔧 故障排除思路**：
1. **检查物理连接**：网线、网卡状态
2. **查看IP配置**：接口地址、子网掩码
3. **检查路由表**：是否有到目标的路由
4. **测试连通性**：ping、traceroute工具
5. **查看ARP表**：地址解析是否正常

**核心记忆要点**：
- **路由表是网络导航图**，告诉数据包该往哪走
- **ip命令是现代标准**，功能强大且语法统一  
- **ARP解决IP到MAC地址映射**，是网络通信的基础
- **默认网关是对外通信的必经之路**
- **配置前要理解，修改后要测试，重要配置要备份**