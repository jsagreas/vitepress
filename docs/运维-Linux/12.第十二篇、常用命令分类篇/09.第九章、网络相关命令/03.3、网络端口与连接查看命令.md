---
title: 3、网络端口与连接查看命令
---
## 📚 目录

1. [网络连接查看概述](#1-网络连接查看概述)
2. [netstat - 网络连接状态查看](#2-netstat-网络连接状态查看)
3. [ss - 现代化socket统计工具](#3-ss-现代化socket统计工具)
4. [lsof - 网络文件描述符查看](#4-lsof-网络文件描述符查看)
5. [fuser - 进程端口占用查询](#5-fuser-进程端口占用查询)
6. [nmap - 端口扫描与服务发现](#6-nmap-端口扫描与服务发现)
7. [telnet - 端口连接测试](#7-telnet-端口连接测试)
8. [nc - 网络连接瑞士军刀](#8-nc-网络连接瑞士军刀)
9. [实际应用场景](#9-实际应用场景)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🌐 网络连接查看概述


### 1.1 为什么需要网络连接查看


**实际场景理解**：
想象你是一个网站管理员，突然发现服务器响应很慢。你需要知道：
- 🔸 **哪些程序在占用网络端口？**
- 🔸 **有多少客户端连接到服务器？**
- 🔸 **是否有异常的网络连接？**
- 🔸 **某个端口是否被正确监听？**

```
现实比喻：
网络连接 = 电话线路
端口 = 电话号码
进程 = 接电话的人

网络查看命令 = 查看电话交换机状态
看谁在打电话，打给谁，通话状态如何
```

### 1.2 网络连接的基本状态


**TCP连接状态机**：
```
客户端                    服务器
   |                        |
   |----[SYN]--------------->|  → SYN_SENT
   |<---[SYN,ACK]------------|  ← SYN_RECV  
   |----[ACK]--------------->|  → ESTABLISHED
   |                        |  ← ESTABLISHED
   |<====数据传输=====>      |
   |----[FIN]--------------->|  → FIN_WAIT1
   |<---[ACK]----------------|  ← CLOSE_WAIT
   |<---[FIN]----------------|  ← LAST_ACK
   |----[ACK]--------------->|  → TIME_WAIT
```

**🔸 连接状态含义解释**：
- **LISTEN** `监听状态`：服务器在等待客户端连接，像商店开门营业
- **ESTABLISHED** `已连接`：双方正在正常通信，像正在通电话
- **TIME_WAIT** `等待关闭`：连接关闭但还在等待，像挂断电话后的忙音
- **CLOSE_WAIT** `等待关闭`：对方想关闭连接，像对方说"我要挂电话了"

---

## 2. 📊 netstat - 网络连接状态查看


### 2.1 netstat基本概念


**netstat是什么？**
- **全称**：Network Statistics（网络统计）
- **作用**：显示网络连接、路由表、接口统计等网络相关信息
- **地位**：Linux系统最经典的网络诊断工具

### 2.2 netstat常用参数详解


**🔸 核心参数组合**：

| 参数 | **含义** | **实际作用** |
|------|---------|-------------|
| `-t` | `显示TCP连接` | `查看网页、邮件等可靠连接` |
| `-u` | `显示UDP连接` | `查看DNS、视频直播等快速连接` |
| `-l` | `只显示监听状态` | `查看哪些服务在等待客户端` |
| `-n` | `显示数字地址` | `不解析域名，显示IP和端口号` |
| `-p` | `显示进程信息` | `查看是哪个程序在使用端口` |

### 2.3 netstat实用命令组合


**🚀 最常用的命令组合**：

```bash
# 查看所有TCP连接（最常用）
netstat -tnlp

# 查看指定端口的连接
netstat -tnlp | grep :80

# 查看连接数统计
netstat -tn | awk '{print $6}' | sort | uniq -c
```

**💡 输出结果解读**：
```bash
$ netstat -tnlp
Proto Recv-Q Send-Q Local Address    Foreign Address  State    PID/Program
tcp   0      0      0.0.0.0:22       0.0.0.0:*        LISTEN   1234/sshd
tcp   0      0      0.0.0.0:80       0.0.0.0:*        LISTEN   5678/nginx
tcp   0      0      192.168.1.100:22 192.168.1.50:54321 ESTABLISHED 9999/sshd

解释说明：
• 第1行：SSH服务在22端口监听，进程ID是1234
• 第2行：Nginx在80端口监听，进程ID是5678  
• 第3行：有个SSH连接正在进行，客户端是192.168.1.50
```

### 2.4 netstat高级用法


**📈 网络连接统计分析**：
```bash
# 统计各种连接状态的数量
netstat -tn | awk 'NR>2{state[$6]++} END{for(s in state) print s,state[s]}'

# 查看连接最多的IP地址
netstat -tn | awk 'NR>2 && $6=="ESTABLISHED"{ip=gensub(/:.*/, "", "g", $5); count[ip]++} END{for(i in count) print count[i], i}' | sort -nr

# 查看端口占用情况
netstat -tnlp | awk 'NR>2{port=gensub(/.*:/, "", "g", $4); if(port ~ /^[0-9]+$/) ports[port]++} END{for(p in ports) print p, ports[p]}' | sort -n
```

---

## 3. ⚡ ss - 现代化socket统计工具


### 3.1 ss与netstat的区别


**为什么用ss替代netstat？**

```
传统netstat的问题：
├─ 速度慢：需要读取/proc文件系统
├─ 资源占用高：在连接数多时性能差  
└─ 功能有限：过滤和查询能力弱

现代ss的优势：
├─ 速度快：直接从内核获取信息
├─ 功能强：支持强大的过滤语法
└─ 信息丰富：显示更详细的socket信息
```

### 3.2 ss基本用法


**🔸 常用参数对照**：

| netstat参数 | **ss对应参数** | **作用说明** |
|------------|---------------|-------------|
| `-t` | `-t` | `显示TCP socket` |
| `-u` | `-u` | `显示UDP socket` |
| `-l` | `-l` | `只显示监听socket` |
| `-n` | `-n` | `不解析服务名` |
| `-p` | `-p` | `显示进程信息` |

**💻 基本命令示例**：
```bash
# 基本查看（比netstat快很多）
ss -tnlp

# 查看指定状态的连接
ss -t state established

# 查看指定端口
ss -tnlp sport = :80
ss -tnlp dport = :3306
```

### 3.3 ss高级过滤功能


**🎯 强大的过滤语法**：

```bash
# 查看连接到指定IP的socket
ss dst 192.168.1.100

# 查看指定端口范围
ss -tn sport \> 1024

# 查看指定进程的连接
ss -tp state established '( dport = :22 or sport = :22 )'

# 组合条件查询
ss -o state established '( dport = :http or sport = :http )' | head -10
```

**🔍 实用过滤示例**：
```bash
# 找出占用端口最多的进程
ss -tnlp | awk 'NR>1{split($4,a,":"); port=a[length(a)]; count[port]++} END{for(p in count) if(count[p]>1) print p,count[p]}'

# 查看TIME_WAIT状态的连接数
ss -tn state time-wait | wc -l

# 查看各个状态的连接统计
ss -tn | awk 'NR>1{state[$1]++} END{for(s in state) print s,state[s]}'
```

---

## 4. 🔍 lsof - 网络文件描述符查看


### 4.1 lsof基本概念


**lsof是什么？**
- **全称**：List Open Files（列出打开的文件）
- **核心思想**：在Linux中"一切皆文件"，网络连接也是文件
- **独特优势**：可以查看进程打开的所有文件，包括网络连接

**🔸 为什么网络连接是文件？**
```
Linux哲学：一切皆文件
├─ 普通文件：存储数据
├─ 设备文件：硬件设备
├─ 管道文件：进程间通信
└─ Socket文件：网络通信

网络连接 = Socket文件描述符
每个网络连接对应一个文件句柄
```

### 4.2 lsof网络相关用法


**🌐 网络连接查看**：

```bash
# 查看所有网络连接
lsof -i

# 查看指定协议的连接
lsof -i tcp
lsof -i udp

# 查看指定端口
lsof -i :80
lsof -i :22-25    # 端口范围

# 查看指定IP的连接
lsof -i @192.168.1.100
```

### 4.3 lsof进程网络分析


**🔍 进程维度分析**：

```bash
# 查看指定进程的网络连接
lsof -i -p 1234

# 查看指定程序的网络连接
lsof -i -c nginx
lsof -i -c ssh

# 查看指定用户的网络连接
lsof -i -u root
lsof -i -u www-data
```

**💡 输出结果解读**：
```bash
$ lsof -i :80
COMMAND  PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
nginx    1234    root   6u   IPv4  12345      0t0  TCP *:http (LISTEN)
nginx    5678 www-data  6u   IPv4  12345      0t0  TCP *:http (LISTEN)

解释说明：
• COMMAND: 程序名称
• PID: 进程ID  
• FD: 文件描述符编号，6u表示第6个描述符，读写模式
• TYPE: 文件类型，IPv4表示网络socket
• NODE: TCP表示协议类型
• NAME: 连接详情，*:http表示监听80端口
```

### 4.4 lsof网络故障排查


**🚨 常见故障排查场景**：

```bash
# 端口被占用排查
lsof -i :8080 | head -5

# 查看僵尸连接
lsof -i | grep -i close_wait

# 查看某个IP的所有连接
lsof -i @suspicious.ip.address

# 找出网络连接数最多的进程
lsof -i | awk 'NR>1{cmd[$1]++} END{for(c in cmd) print cmd[c],c}' | sort -nr | head -10
```

---

## 5. 🎯 fuser - 进程端口占用查询


### 5.1 fuser基本概念


**fuser是什么？**
- **全称**：File User（文件用户）
- **核心功能**：查看哪些进程在使用指定的文件或端口
- **使用场景**：快速找到占用端口的进程

### 5.2 fuser端口查询


**🔸 基本语法**：
```bash
# 查看端口占用
fuser -n tcp 端口号

# 显示详细信息
fuser -v -n tcp 端口号

# 强制终止占用进程
fuser -k -n tcp 端口号
```

**💻 实际使用示例**：
```bash
# 查看80端口被谁占用
fuser -n tcp 80

# 查看详细的进程信息
fuser -v -n tcp 22
#                     USER        PID ACCESS COMMAND
# 22/tcp:              root       1234 F.... sshd

# 一次查看多个端口
fuser -v -n tcp 22,80,443
```

### 5.3 fuser的ACCESS码含义


**🔸 ACCESS访问码说明**：

| 访问码 | **含义** | **说明** |
|-------|---------|---------|
| `F` | `文件打开` | `进程打开了文件` |
| `f` | `文件打开(写入模式)` | `进程以写入方式打开文件` |
| `c` | `当前目录` | `进程的当前工作目录` |
| `r` | `根目录` | `进程的根目录` |
| `m` | `mmap文件` | `内存映射文件` |

### 5.4 fuser实用技巧


**⚡ 快速故障处理**：
```bash
# 快速查看并终止占用8080端口的进程
fuser -k -n tcp 8080

# 查看文件被哪些进程使用
fuser -v /var/log/nginx/access.log

# 批量检查端口占用
for port in 22 80 443 3306; do
    echo "=== Port $port ==="
    fuser -v -n tcp $port 2>/dev/null
done
```

---

## 6. 🔍 nmap - 端口扫描与服务发现


### 6.1 nmap基本概念


**nmap是什么？**
- **全称**：Network Mapper（网络映射器）
- **核心功能**：网络发现和端口扫描
- **主要用途**：安全测试、网络诊断、服务发现

**⚠️ 使用注意事项**：
```
合法使用场景：
├─ 扫描自己管理的服务器
├─ 网络故障诊断
└─ 授权的安全测试

禁止用途：
├─ 扫描他人服务器
├─ 恶意攻击探测
└─ 未授权的安全测试
```

### 6.2 nmap基本扫描


**🔸 基本扫描命令**：
```bash
# 扫描单个主机的常用端口
nmap 192.168.1.100

# 扫描指定端口
nmap -p 80,443,22 192.168.1.100

# 扫描端口范围
nmap -p 1-1000 192.168.1.100

# 快速扫描（只扫描最常用的100个端口）
nmap -F 192.168.1.100
```

**🌐 网络段扫描**：
```bash
# 扫描整个子网
nmap 192.168.1.0/24

# 扫描多个主机
nmap 192.168.1.100-110

# 活跃主机发现
nmap -sn 192.168.1.0/24
```

### 6.3 nmap服务识别


**🔍 服务版本识别**：
```bash
# 识别服务版本
nmap -sV 192.168.1.100

# 操作系统识别
nmap -O 192.168.1.100

# 综合扫描（版本+系统）
nmap -A 192.168.1.100
```

**💡 输出结果解读**：
```bash
$ nmap -sV 192.168.1.100
PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 7.4 (protocol 2.0)
80/tcp  open  http    nginx 1.16.1
443/tcp open  https   nginx 1.16.1
3306/tcp open mysql   MySQL 5.7.28

解释说明：
• 22端口：运行SSH服务，版本是OpenSSH 7.4
• 80端口：运行HTTP服务，使用nginx 1.16.1
• 443端口：运行HTTPS服务
• 3306端口：运行MySQL数据库，版本5.7.28
```

### 6.4 nmap脚本扫描


**📋 常用脚本扫描**：
```bash
# 默认脚本扫描
nmap -sC 192.168.1.100

# 漏洞扫描脚本
nmap --script vuln 192.168.1.100

# HTTP服务信息收集
nmap --script http-title,http-headers 192.168.1.100

# 数据库服务探测
nmap --script mysql-info 192.168.1.100
```

---

## 7. 📞 telnet - 端口连接测试


### 7.1 telnet基本概念


**telnet的现代用途**：
- **原始用途**：远程登录（现在已被SSH替代）
- **现代用途**：测试TCP端口连通性
- **优势**：简单直观，系统自带

### 7.2 telnet端口测试


**🔸 基本测试语法**：
```bash
telnet 主机地址 端口号
```

**💻 实际测试示例**：
```bash
# 测试网站80端口
telnet www.baidu.com 80

# 测试本地SSH端口  
telnet localhost 22

# 测试数据库端口
telnet 192.168.1.100 3306
```

**📊 连接结果判断**：
```bash
# 连接成功的表现
$ telnet www.baidu.com 80
Trying 39.156.66.10...
Connected to www.a.shifen.com.
Escape character is '^]'.

# 连接失败的表现
$ telnet 192.168.1.100 8080
Trying 192.168.1.100...
telnet: Unable to connect to remote host: Connection refused

# 超时的表现
$ telnet 192.168.1.200 80
Trying 192.168.1.200...
(长时间无响应，最终超时)
```

### 7.3 telnet高级用法


**🌐 HTTP协议测试**：
```bash
# 连接到HTTP服务器
telnet www.example.com 80

# 然后输入HTTP请求
GET / HTTP/1.1
Host: www.example.com
(按两次回车)
```

**📧 邮件服务器测试**：
```bash
# 测试SMTP服务器
telnet smtp.gmail.com 25

# 测试POP3服务器
telnet pop.gmail.com 110
```

---

## 8. 🔧 nc - 网络连接瑞士军刀


### 8.1 nc基本概念


**nc是什么？**
- **全称**：NetCat（网络猫）
- **别名**：网络瑞士军刀
- **核心功能**：创建任意的TCP/UDP连接
- **特点**：功能强大、使用灵活

### 8.2 nc端口测试


**🔸 基本连接测试**：
```bash
# 测试TCP端口
nc -v 192.168.1.100 80

# 测试UDP端口
nc -u -v 192.168.1.100 53

# 扫描端口范围
nc -v -n -z 192.168.1.100 20-25
```

**💡 参数说明**：
- `-v`：显示详细信息
- `-n`：不进行DNS解析
- `-z`：只扫描，不发送数据
- `-u`：使用UDP协议

### 8.3 nc高级功能


**🌐 创建服务端监听**：
```bash
# 在指定端口监听
nc -l 8888

# 监听并保存接收到的数据
nc -l 8888 > received.txt

# 监听特定网卡
nc -l -s 192.168.1.100 8888
```

**📡 客户端连接**：
```bash
# 连接到监听端口
nc 192.168.1.100 8888

# 发送文件
nc 192.168.1.100 8888 < file.txt

# 创建反向shell（仅用于授权测试）
nc 192.168.1.100 8888 -e /bin/bash
```

### 8.4 nc实用场景


**📋 常见应用场景**：

```bash
# 1. 文件传输
# 接收端：
nc -l 9999 > received_file.txt
# 发送端：
nc 192.168.1.100 9999 < file_to_send.txt

# 2. 端口转发
nc -l 8080 | nc target_host 80

# 3. 聊天工具
# 服务器端：
nc -l 9999
# 客户端：
nc server_ip 9999

# 4. 网络速度测试
# 服务器端：
nc -l 9999 > /dev/null
# 客户端：
dd if=/dev/zero bs=1M count=100 | nc server_ip 9999
```

---

## 9. 🎯 实际应用场景


### 9.1 常见故障排查流程


**🚨 服务器无法访问排查步骤**：

```bash
# Step 1: 确认服务是否启动
systemctl status nginx

# Step 2: 检查端口是否监听
ss -tnlp | grep :80
# 或者
netstat -tnlp | grep :80

# Step 3: 确认进程是否正常
lsof -i :80

# Step 4: 测试端口连通性
telnet localhost 80
# 或者
nc -v localhost 80

# Step 5: 检查防火墙设置
iptables -L | grep 80
# 或者
firewall-cmd --list-ports
```

### 9.2 性能监控场景


**📊 连接数监控脚本**：
```bash
#!/bin/bash
# 监控网络连接状态

echo "=== 网络连接统计 ==="
ss -s

echo -e "\n=== TCP连接状态统计 ==="
ss -tn | awk 'NR>1{state[$1]++} END{for(s in state) print s,state[s]}'

echo -e "\n=== 端口监听情况 ==="
ss -tnlp | awk 'NR>1{split($4,a,":"); port=a[length(a)]; print port,$7}' | sort -n

echo -e "\n=== 连接数最多的IP ==="
ss -tn state established | awk '{split($4,a,":"); ip=a[1]; count[ip]++} END{for(i in count) print count[i],i}' | sort -nr | head -5
```

### 9.3 安全检查场景


**🔒 安全检查清单**：

```bash
# 1. 检查异常端口监听
netstat -tnlp | awk '$6=="LISTEN" && $4 !~ /(22|80|443|25|53|21|20)$/ {print}'

# 2. 检查可疑外连
netstat -tn | awk '$6=="ESTABLISHED" && $5 !~ /^(192\.168\.|10\.|172\.(1[6-9]|2[0-9]|3[01])\.)/ {print $5}' | sort | uniq -c | sort -nr

# 3. 检查TIME_WAIT连接过多
netstat -tn | grep TIME_WAIT | wc -l

# 4. 检查root用户的网络连接
lsof -i -u root | grep ESTABLISHED
```

---

## 10. 📋 核心要点总结


### 10.1 命令选择指南


**🔸 根据需求选择工具**：

```
查看网络连接状态：
├─ 快速查看：ss -tnlp ⚡
├─ 详细分析：netstat -tnlp 📊
└─ 兼容老系统：netstat

查看端口占用：
├─ 简单查询：fuser -n tcp 端口 🎯
├─ 详细信息：lsof -i :端口 🔍
└─ 进程视角：ss -tnlp | grep 端口

测试端口连通性：
├─ 基本测试：telnet 主机 端口 📞
├─ 高级功能：nc -v 主机 端口 🔧
└─ 批量扫描：nmap 主机 🔍

排查网络问题：
├─ 内部排查：ss + lsof + fuser 💻
├─ 外部测试：telnet + nc + nmap 🌐
└─ 综合分析：组合使用多个工具
```

### 10.2 必须掌握的核心概念


**🎯 网络连接基础**：
- **端口**：程序与外界通信的门户号码
- **监听**：程序等待客户端连接的状态
- **连接状态**：TCP连接在不同阶段的状态标识
- **Socket**：网络通信的端点，在Linux中表现为文件

**⚡ 工具使用要点**：
- **ss替代netstat**：现代系统优先使用ss，速度更快
- **组合使用**：不同工具有不同优势，组合使用效果更好
- **安全意识**：nmap等工具要在授权范围内使用
- **实践为主**：多在实际环境中练习，积累经验

### 10.3 实用记忆技巧


**💡 命令记忆口诀**：
```
netstat老工具，功能很全面
ss是新秀，速度快如电
lsof看文件，网络也能见
fuser查占用，端口归属显
nmap做扫描，服务发现全
telnet测连通，简单又直观
nc是军刀，功能最齐全
```

**🔧 故障排查三步法**：
1. **确认服务**：systemctl status 服务名
2. **检查端口**：ss -tnlp | grep 端口
3. **测试连通**：telnet/nc 测试连接

**核心记忆**：
- 网络排查从内到外：先查本机服务，再测外部连接
- 工具各有所长：ss查状态，lsof看进程，nc测连通
- 安全第一：扫描工具只在授权范围内使用
- 实践出真知：多动手操作，熟能生巧