---
title: 14、网络性能测试命令
---
## 📚 目录

1. [网络性能测试概述](#1-网络性能测试概述)
2. [iperf3带宽测试工具](#2-iperf3带宽测试工具)
3. [netperf网络性能测试](#3-netperf网络性能测试)
4. [speedtest-cli网速测试](#4-speedtest-cli网速测试)
5. [网络延迟测试方法](#5-网络延迟测试方法)
6. [网络质量评估工具](#6-网络质量评估工具)
7. [网络性能基准测试](#7-网络性能基准测试)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌐 网络性能测试概述


### 1.1 什么是网络性能测试


**💡 通俗理解**：网络性能测试就像给你的网络"体检"，检查网络连接的速度快慢、稳不稳定

```
生活类比：
网络性能测试 = 汽车性能测试
• 带宽测试 = 测最高车速（能跑多快）
• 延迟测试 = 测加速性能（反应多快）
• 丢包测试 = 测稳定性（会不会抛锚）
• 吞吐量测试 = 测载重能力（能传多少数据）
```

### 1.2 网络性能的核心指标


**🎯 关键指标解释**
```
① 带宽（Bandwidth）：
   含义：网络管道的粗细，能同时传输多少数据
   单位：Mbps、Gbps
   通俗理解：高速公路的车道数量

② 延迟（Latency）：  
   含义：数据从A点到B点需要多长时间
   单位：ms（毫秒）
   通俗理解：快递送达时间

③ 吞吐量（Throughput）：
   含义：实际每秒传输的数据量
   关系：吞吐量 ≤ 带宽
   通俗理解：实际通过的车流量

④ 丢包率（Packet Loss）：
   含义：传输过程中丢失的数据包比例
   单位：百分比（%）
   通俗理解：快递丢失率
```

### 1.3 为什么要做网络性能测试


**🔍 实际应用价值**
```
网络故障排查：
• 网页打开慢 → 检查带宽和延迟
• 视频卡顿 → 检查吞吐量和丢包
• 游戏卡顿 → 检查延迟和稳定性

网络规划：
• 选择ISP服务商
• 规划网络拓扑
• 评估网络容量

性能优化：
• 找出网络瓶颈
• 验证优化效果
• 制定SLA标准
```

---

## 2. ⚡ iperf3带宽测试工具


### 2.1 iperf3基本概念


**🔧 什么是iperf3**
- **定义**：专业的网络带宽测试工具
- **原理**：在两台机器间传输测试数据，测量实际传输速度
- **特点**：简单易用、功能强大、跨平台支持

**💻 安装方法**
```bash
# Ubuntu/Debian
sudo apt install iperf3

# CentOS/RHEL
sudo yum install iperf3

# 检查安装
iperf3 --version
```

### 2.2 iperf3基本使用


**🏗️ 工作模式解释**
```
iperf3采用客户端-服务端模式：

服务端（Server）：               客户端（Client）：
┌─────────────┐                 ┌─────────────┐
│  监听端口   │ ←─── 测试数据 ─── │  发送数据   │
│  接收数据   │                 │  计算速度   │
│  计算性能   │                 │  显示结果   │
└─────────────┘                 └─────────────┘

通俗理解：
服务端 = 靶场（接收子弹，测量精度）
客户端 = 射手（发射子弹，查看成绩）
```

**📊 基础测试步骤**

① **启动服务端**
```bash
# 在目标机器上启动服务端
iperf3 -s
# 输出：Server listening on 5201
```

② **运行客户端测试**
```bash
# 在测试机器上连接服务端
iperf3 -c 192.168.1.100

# 输出示例：
# [ ID] Interval           Transfer     Bitrate
# [  5]   0.00-10.00  sec  1.09 GBytes   934 Mbits/sec
```

### 2.3 iperf3高级参数


**🎛️ 常用参数详解**

| 参数 | **含义** | **示例** | **说明** |
|------|---------|----------|----------|
| `-c` | `指定服务端IP` | `iperf3 -c 192.168.1.100` | `客户端连接目标` |
| `-s` | `启动服务端模式` | `iperf3 -s` | `监听连接请求` |
| `-t` | `测试持续时间` | `iperf3 -c IP -t 30` | `测试30秒` |
| `-P` | `并行连接数` | `iperf3 -c IP -P 4` | `4个并行连接` |
| `-u` | `UDP模式测试` | `iperf3 -c IP -u` | `默认是TCP` |
| `-R` | `反向测试` | `iperf3 -c IP -R` | `服务端向客户端发送` |
| `-b` | `限制带宽` | `iperf3 -c IP -u -b 100M` | `UDP限速100Mbps` |

**💡 实际测试案例**

**案例1：全面带宽测试**
```bash
# 双向测试（上传+下载）
iperf3 -c 192.168.1.100 -t 30 -P 4
iperf3 -c 192.168.1.100 -t 30 -P 4 -R

解读：
-t 30    → 测试30秒（更准确）
-P 4     → 4个并行连接（模拟多用户）
-R       → 反向测试（测试下载速度）
```

**案例2：UDP性能测试**
```bash
# UDP带宽测试
iperf3 -c 192.168.1.100 -u -b 1G -t 10

# 结果解读：
# Transfer: 1.16 GBytes    → 传输总量
# Bitrate:  1.00 Gbits/sec → 传输速率  
# Lost:     0 (0%)         → 丢包情况
```

### 2.4 结果分析与问题排查


**📈 结果指标解读**
```
典型输出分析：
[  5]   0.00-10.00  sec  1.09 GBytes   934 Mbits/sec    sender
[  5]   0.00-10.04  sec  1.09 GBytes   930 Mbits/sec    receiver

解读：
• Transfer（1.09 GBytes）：10秒内传输的数据量
• Bitrate（934 Mbits/sec）：平均传输速度
• sender vs receiver：发送端和接收端的测量结果
• 差异小 = 网络稳定；差异大 = 可能有问题
```

**❗ 常见问题分析**
```
问题1：速度远低于预期
可能原因：
• 网络拥塞
• 硬件限制（网卡、CPU）
• 防火墙限制
解决：增加并行连接数 -P 参数

问题2：UDP丢包严重  
可能原因：
• 带宽设置过高 -b 参数
• 网络设备处理能力不足
解决：降低测试带宽

问题3：测试不稳定
可能原因：
• 测试时间太短
• 网络波动
解决：延长测试时间 -t 参数
```

---

## 3. 🔬 netperf网络性能测试


### 3.1 netperf工具介绍


**🎯 netperf的特点**
- **功能全面**：支持TCP、UDP、多种测试模式
- **精确测量**：提供更详细的性能指标
- **灵活配置**：可测试不同数据包大小、连接模式

**💻 安装配置**
```bash
# 安装netperf
sudo apt install netperf     # Ubuntu
sudo yum install netperf     # CentOS

# 启动netserver服务端
netserver
# 输出：Starting netserver with host 'IN(6)ADDR_ANY' port '12865' and family AF_UNSPEC
```

### 3.2 netperf测试模式


**📊 主要测试类型**

**① TCP_STREAM（TCP流测试）**
```bash
# 基本TCP带宽测试
netperf -H 192.168.1.100

# 结果示例：
# MIGRATED TCP STREAM TEST
# Recv   Send    Send                          
# Socket Socket  Message  Elapsed              
# Size   Size    Size     Time     Throughput  
# bytes  bytes   bytes    secs.    10^6bits/sec  
# 131072  16384  16384    10.00     941.23
```

**② TCP_RR（TCP请求-响应测试）**
```bash
# 测试延迟和并发处理能力
netperf -H 192.168.1.100 -t TCP_RR

# 结果解读：
# TCP REQUEST/RESPONSE TEST
# Local /Remote
# Socket Size   Request  Resp.   Elapsed  Trans.
# Send   Recv   Size     Size    Time     Rate         
# bytes  bytes  bytes    bytes   secs.    per sec   
# 16384  131072 1        1       10.00    4521.15
```

**③ UDP_STREAM（UDP流测试）**  
```bash
# UDP带宽和丢包测试
netperf -H 192.168.1.100 -t UDP_STREAM

# 加上丢包检测
netperf -H 192.168.1.100 -t UDP_STREAM -- -m 1024
```

### 3.3 netperf高级参数


**🔧 重要参数说明**

```bash
# 完整语法
netperf -H 主机 -t 测试类型 -l 持续时间 -- -参数

常用参数组合：
# 指定测试时间
netperf -H 192.168.1.100 -l 30

# 指定消息大小  
netperf -H 192.168.1.100 -t TCP_STREAM -- -m 8192

# 指定发送缓冲区大小
netperf -H 192.168.1.100 -t TCP_STREAM -- -s 32768

# 组合测试
netperf -H 192.168.1.100 -t TCP_STREAM -l 30 -- -m 1024 -s 32768
```

**📋 测试场景对照表**

| 测试类型 | **适用场景** | **关注指标** | **典型应用** |
|---------|------------|-------------|-------------|
| `TCP_STREAM` | `大文件传输` | `吞吐量` | `文件下载、视频流` |
| `TCP_RR` | `交互式应用` | `延迟、TPS` | `Web应用、数据库` |
| `UDP_STREAM` | `实时传输` | `带宽、丢包` | `视频通话、游戏` |
| `TCP_CRR` | `短连接场景` | `连接建立速度` | `HTTP请求` |

---

## 4. 🌍 speedtest-cli网速测试


### 4.1 speedtest-cli基本使用


**🎯 什么是speedtest-cli**
- **定义**：命令行版本的网速测试工具
- **原理**：连接Speedtest.net服务器测试真实网速
- **优势**：简单直观，测试真实上网速度

**💻 安装和基本使用**
```bash
# 安装方法
sudo apt install speedtest-cli    # Ubuntu
sudo yum install speedtest-cli    # CentOS
# 或者用pip安装
pip install speedtest-cli

# 基本测试
speedtest-cli

# 输出示例：
# Retrieving speedtest.net configuration...
# Testing from China Telecom (1.2.3.4)...
# Selecting best server based on ping...
# Testing download speed................
# Download: 95.23 Mbit/s
# Testing upload speed..................  
# Upload: 10.15 Mbit/s
```

### 4.2 speedtest-cli参数详解


**🎛️ 常用参数**

```bash
# 查看可用服务器
speedtest-cli --list

# 指定服务器测试
speedtest-cli --server 服务器ID

# 只测下载速度  
speedtest-cli --no-upload

# 只测上传速度
speedtest-cli --no-download

# 简化输出
speedtest-cli --simple

# JSON格式输出
speedtest-cli --json

# 分享测试结果
speedtest-cli --share
```

**📊 实际使用案例**

**案例1：快速网速检测**
```bash
# 简单测试，只看结果
speedtest-cli --simple

# 输出：
# Ping: 15.234 ms
# Download: 95.23 Mbit/s  
# Upload: 10.15 Mbit/s
```

**案例2：指定服务器测试**
```bash
# 先查看附近服务器
speedtest-cli --list | head -10

# 选择最近的服务器测试
speedtest-cli --server 1234

# 用于：测试到特定地区的网速
```

### 4.3 结果解读与网速评估


**📈 网速标准参考**
```
家庭宽带速度参考：
• 下载速度：
  - 10-30 Mbps：基本上网需求
  - 50-100 Mbps：高清视频、多设备
  - 100+ Mbps：4K视频、大文件下载

• 上传速度：
  - 1-5 Mbps：基本需求  
  - 10+ Mbps：视频通话、直播
  - 20+ Mbps：专业需求

• 延迟（Ping）：
  - <20ms：优秀
  - 20-50ms：良好
  - 50-100ms：一般
  - >100ms：较差
```

---

## 5. ⏱️ 网络延迟测试方法


### 5.1 ping命令详解


**🎯 ping的工作原理**
```
ping工作过程：
本地主机                     目标主机
    |                           |
    |──── ICMP Echo Request ──→ |
    |                           | (处理请求)
    |←─── ICMP Echo Reply ───── |
    |                           |
    ↓
计算往返时间(RTT)
```

**💻 ping常用参数**
```bash
# 基本使用
ping google.com

# 指定ping次数
ping -c 4 google.com

# 指定ping间隔
ping -i 0.5 google.com     # 每0.5秒ping一次

# 指定数据包大小
ping -s 1000 google.com    # 发送1000字节数据包

# 指定网络接口
ping -I eth0 google.com

# 只显示统计信息
ping -c 10 -q google.com
```

### 5.2 高级延迟测试


**🔍 traceroute路径追踪**
```bash
# 追踪数据包路径
traceroute google.com

# 输出解读：
#  1  192.168.1.1 (192.168.1.1)     1.234 ms    # 路由器
#  2  10.0.0.1 (10.0.0.1)          5.678 ms    # ISP网关  
#  3  202.106.1.1 (202.106.1.1)   15.234 ms   # ISP骨干
#  ...
# 每一跳都显示延迟时间，帮助定位网络瓶颈

# IPv6追踪
traceroute6 ipv6.google.com

# TCP追踪（绕过ICMP限制）
traceroute -T -p 80 google.com
```

**⚡ mtr网络诊断工具**
```bash
# 安装mtr
sudo apt install mtr

# 实时网络质量监控
mtr google.com

# 输出：
#                        My traceroute  [v0.93]
# HOST: localhost              Loss%   Snt   Last   Avg  Best  Wrst StDev
#  1.|-- 192.168.1.1            0.0%    10    1.2   1.3   1.1   1.8   0.2
#  2.|-- 10.0.0.1               0.0%    10    5.6   5.8   5.2   7.1   0.6
#  3.|-- 202.106.1.1            2.0%    10   15.2  16.1  14.8  19.3   1.4

# 关注指标：
# Loss%：丢包率
# Avg：平均延迟  
# StDev：延迟稳定性（越小越稳定）
```

---

## 6. 🔧 网络质量评估工具


### 6.1 综合网络测试


**📊 多维度测试脚本**
```bash
#!/bin/bash
# 网络综合测试脚本

echo "=== 网络连通性测试 ==="
ping -c 4 8.8.8.8

echo -e "\n=== 网络延迟测试 ==="
ping -c 10 -q google.com

echo -e "\n=== 网络路径测试 ==="  
mtr --report --report-cycles 10 google.com

echo -e "\n=== 网络速度测试 ==="
speedtest-cli --simple

echo -e "\n=== DNS解析测试 ==="
nslookup google.com
```

### 6.2 网络抖动测试


**⚡ 延迟稳定性检测**
```bash
# 长时间ping测试，观察延迟变化
ping -c 100 -i 0.1 google.com | \
awk 'BEGIN{min=9999; max=0} 
     /time=/{
       gsub(/time=/, ""); gsub(/ms/, ""); 
       if($7<min) min=$7; 
       if($7>max) max=$7; 
       sum+=$7; count++
     } 
     END{
       print "延迟统计:"; 
       print "最小:", min "ms"; 
       print "最大:", max "ms"; 
       print "平均:", sum/count "ms";
       print "抖动:", max-min "ms"
     }'
```

### 6.3 网络质量评级


**📈 质量评估标准**
```
网络质量评估表：

延迟质量：
★★★★★ (优秀)：<10ms，抖动<2ms
★★★★☆ (良好)：10-30ms，抖动<5ms  
★★★☆☆ (一般)：30-80ms，抖动<10ms
★★☆☆☆ (较差)：80-200ms，抖动<20ms
★☆☆☆☆ (很差)：>200ms，抖动>20ms

丢包率质量：
★★★★★：0%
★★★★☆：<0.1%
★★★☆☆：0.1%-1%
★★☆☆☆：1%-5%
★☆☆☆☆：>5%

速度质量（相对带宽）：
★★★★★：>90% 带宽利用率
★★★★☆：70-90%
★★★☆☆：50-70%
★★☆☆☆：30-50%  
★☆☆☆☆：<30%
```

---

## 7. 📊 网络性能基准测试


### 7.1 制定测试计划


**🎯 基准测试步骤**

```
测试计划制定：

① 确定测试目标
   • 网络容量规划
   • 性能问题排查  
   • SLA验证

② 选择测试工具
   • 带宽测试：iperf3
   • 延迟测试：ping/mtr
   • 应用层测试：curl/wget

③ 设计测试场景
   • 单连接vs多连接
   • 不同数据包大小
   • 不同时间段测试

④ 收集基准数据
   • 多次测试取平均值
   • 记录环境参数
   • 建立性能基线
```

### 7.2 自动化测试脚本


**🔧 性能监控脚本**
```bash
#!/bin/bash
# 网络性能基准测试脚本

TARGET_HOST="192.168.1.100"
LOG_FILE="/tmp/network_benchmark_$(date +%Y%m%d).log"

echo "开始网络性能基准测试..." | tee -a $LOG_FILE
echo "测试时间: $(date)" | tee -a $LOG_FILE
echo "目标主机: $TARGET_HOST" | tee -a $LOG_FILE

# TCP带宽测试
echo -e "\n=== TCP带宽测试 ===" | tee -a $LOG_FILE
iperf3 -c $TARGET_HOST -t 30 | tee -a $LOG_FILE

# UDP测试 
echo -e "\n=== UDP性能测试 ===" | tee -a $LOG_FILE
iperf3 -c $TARGET_HOST -u -b 100M -t 10 | tee -a $LOG_FILE

# 延迟测试
echo -e "\n=== 延迟测试 ===" | tee -a $LOG_FILE  
ping -c 20 -q $TARGET_HOST | tee -a $LOG_FILE

echo "测试完成！结果保存在 $LOG_FILE"
```

### 7.3 性能基线建立


**📈 基线数据管理**
```bash
# 创建性能基线文件
cat > network_baseline.txt << EOF
=== 网络性能基线数据 ===
测试环境: 千兆局域网
测试时间: $(date)

基准指标:
• TCP带宽: 950 Mbps
• UDP带宽: 900 Mbps (丢包<0.1%)
• 延迟: 0.5ms (抖动<0.1ms)
• 并发连接: 1000+ TPS

告警阈值:
• 带宽低于80%基线值
• 延迟超过基线2倍  
• 丢包率>1%
• TPS低于基线50%
EOF
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🎯 网络性能核心指标：
• 带宽：网络管道粗细，决定最大传输能力
• 延迟：数据传输时间，影响响应速度
• 吞吐量：实际传输速度，受多种因素影响  
• 丢包率：数据丢失比例，影响传输质量

🔧 核心测试工具：
• iperf3：专业带宽测试，支持TCP/UDP
• netperf：全面性能测试，多种测试模式
• speedtest-cli：真实网速测试，简单易用
• ping/mtr：延迟和路径诊断工具
```

### 8.2 关键理解要点


**💡 工具选择指南**
```
选择原则：
• 局域网测试 → iperf3/netperf
• 互联网测试 → speedtest-cli  
• 延迟诊断 → ping/mtr
• 应用性能 → 专用工具

测试场景对应：
• 文件传输慢 → 带宽测试
• 网页打开慢 → 延迟+DNS测试
• 视频卡顿 → 丢包+稳定性测试
• 游戏卡顿 → 延迟抖动测试
```

**⚠️ 测试注意事项**
```
准确性保障：
① 测试环境：避开网络高峰期
② 测试时长：至少30秒，获得稳定结果
③ 多次测试：取平均值，排除偶然因素
④ 排除干扰：关闭其他网络应用

结果解读：
• 理论值vs实际值：考虑协议开销
• 峰值vs均值：关注稳定性
• 上行vs下行：通常不对称
• TCP vs UDP：不同应用场景
```

### 8.3 实际应用指导


**🛠️ 故障排查流程**
```
网络故障诊断步骤：

① 连通性检查
   ping 目标主机 → 确认基本连通

② 路径诊断  
   traceroute/mtr → 找出问题节点

③ 性能测试
   iperf3/speedtest → 量化性能指标

④ 深入分析
   netstat/ss → 检查连接状态
   tcpdump → 抓包分析
```

**📊 性能优化建议**
```
常见优化措施：

网络层面：
• 升级带宽：提高传输能力
• 优化路由：选择最佳路径  
• 负载均衡：分散网络压力

系统层面：
• 调整缓冲区：匹配网络带宽
• 优化TCP参数：提高传输效率
• 升级网卡驱动：发挥硬件性能

应用层面：  
• 数据压缩：减少传输量
• 连接复用：降低建连开销
• 缓存策略：减少网络请求
```

**📝 性能监控建议**
```
建立监控体系：
① 基线建立：记录正常情况下的性能指标
② 持续监控：定期执行性能测试
③ 告警机制：设置阈值，及时发现问题
④ 趋势分析：观察性能变化趋势

监控重点：
• 关键路径的延迟和丢包
• 核心应用的带宽利用率  
• 网络设备的负载状况
• 用户体验相关指标
```

**核心记忆口诀**：
- 网络测试四要素：带宽延迟吞吐丢包
- iperf3测带宽，ping命令测延迟  
- speedtest测网速，mtr诊断路径
- 多次测试取均值，基线对比找问题