---
title: 9、网络流量监控命令
---
## 📚 目录

1. [网络流量监控概述](#1-网络流量监控概述)
2. [iftop实时网络流量监控](#2-iftop实时网络流量监控)
3. [nethogs进程网络监控](#3-nethogs进程网络监控)
4. [iotop磁盘IO监控](#4-iotop磁盘io监控)
5. [nload网络负载监控](#5-nload网络负载监控)
6. [vnstat网络流量统计](#6-vnstat网络流量统计)
7. [tcpdump数据包捕获](#7-tcpdump数据包捕获)
8. [tshark命令行抓包工具](#8-tshark命令行抓包工具)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🌐 网络流量监控概述


### 1.1 为什么需要网络流量监控


**网络监控的价值**：
在日常Linux系统管理中，网络问题往往是最难定位的。当你的服务器突然变慢，或者网络断断续续时，你需要知道：
- **谁在占用网络**：哪个程序或进程在大量使用网络
- **流量去向**：数据包从哪里来，到哪里去
- **流量大小**：具体的上传下载速度是多少
- **历史趋势**：网络使用的长期变化规律

> 💡 **生活类比**：就像家里的水表和电表一样，网络监控工具帮你看清楚"网络资源"被谁用了多少

### 1.2 监控工具分类


**按监控维度分类**：
```
实时监控类：
├── iftop     → 看连接和流量（像看实时股票行情）
├── nethogs   → 看进程网络使用（哪个程序在联网）
├── nload     → 看总体网络负载（像看汽车仪表盘）
└── iotop     → 看磁盘IO（虽然不是网络，但常配合使用）

统计分析类：
├── vnstat    → 看历史数据统计（像看月度账单）
└── ss/netstat → 看网络连接状态

数据包分析类：
├── tcpdump   → 抓包分析（像录像回放）
└── tshark    → 图形化抓包的命令行版本
```

---

## 2. 🔍 iftop实时网络流量监控


### 2.1 iftop基本概念


**什么是iftop**：
`iftop`就像网络世界的"任务管理器"，实时显示网络连接和每个连接的流量大小。

**安装方法**：
```bash
# CentOS/RHEL
yum install iftop

# Ubuntu/Debian  
apt-get install iftop
```

### 2.2 iftop使用详解


**基本使用**：
```bash
# 最简单的使用方式
iftop

# 指定网卡监控
iftop -i eth0

# 不解析主机名（提高性能）
iftop -n
```

**界面解读**：
```
iftop界面布局：
┌────────────────────────────────────────────────┐
│   12.5KB  25.0KB  37.5KB  50.0KB              │ ← 流量刻度尺
│───────────────────────────────────────────────│
│server.com    ⇒ client.com     1.23MB  890KB  │ ← 连接和流量
│              ⇐                 2.45MB  1.2MB  │
│───────────────────────────────────────────────│
│TX:  cumulative   rate         total    avg    │ ← 发送统计
│RX:  cumulative   rate         total    avg    │ ← 接收统计
│TOTAL: cumulative rate         total    avg    │ ← 总计统计
└────────────────────────────────────────────────┘

说明：
⇒ 表示出去的流量（上传）
⇐ 表示进来的流量（下载）
右侧数字：2秒平均值、10秒平均值、40秒平均值
```

### 2.3 iftop实用技巧


**交互式操作**：
```
在iftop运行时按键：
- p：显示/隐藏端口号
- n：显示/隐藏域名解析  
- N：显示/隐藏端口名称
- t：显示格式切换（文本模式）
- 1/2/3：排序方式（按不同时间段排序）
- </>：按流量大小排序
- q：退出
```

**高级参数**：
```bash
# 监控特定端口的流量
iftop -f "port 80"

# 只显示进出某个IP的流量  
iftop -f "host 192.168.1.100"

# 监控特定网段
iftop -f "net 192.168.1.0/24"

# 组合过滤条件
iftop -f "port 80 or port 443"
```

> ⚠️ **注意**：iftop需要root权限才能运行，因为它需要直接访问网络接口

---

## 3. 🎯 nethogs进程网络监控


### 3.1 nethogs基本原理


**什么是nethogs**：
如果说`iftop`告诉你"有很多流量"，那`nethogs`告诉你"是哪个程序产生的流量"。它按进程分组显示网络使用情况。

**安装方法**：
```bash
# CentOS/RHEL (需要EPEL源)
yum install nethogs

# Ubuntu/Debian
apt-get install nethogs
```

### 3.2 nethogs使用方法


**基本语法**：
```bash
# 监控所有网络接口
nethogs

# 监控指定网卡
nethogs eth0

# 监控多个网卡
nethogs eth0 eth1

# 指定刷新间隔（秒）
nethogs -d 5
```

**界面解读**：
```
nethogs显示界面：
┌─────────────────────────────────────────────────────┐
│PID    USER    PROGRAM              DEV    SENT   RECV│
│1234   root    /usr/bin/wget        eth0   0.5MB  2.1MB│
│5678   apache  /usr/sbin/httpd      eth0   1.2MB  0.8MB│
│9012   mysql   /usr/sbin/mysqld     eth0   0.3MB  0.1MB│
│?      ?       unknown TCP          eth0   0.1MB  0.0MB│
└─────────────────────────────────────────────────────┘

字段说明：
- PID：进程ID
- USER：运行进程的用户
- PROGRAM：程序完整路径  
- DEV：使用的网络设备
- SENT：发送的流量
- RECV：接收的流量
```

### 3.3 nethogs实用场景


**排查网络占用**：
```bash
# 快速找出网络使用最多的进程
nethogs -s

# 只显示超过指定流量的进程
nethogs -t
```

**结合其他命令使用**：
```bash
# 配合ps命令查看进程详情
ps aux | grep [进程PID]

# 查看进程的网络连接
lsof -p [进程PID]
```

> 💡 **实用技巧**：当服务器网络异常时，先用`nethogs`找到占用网络的进程，再用`ps`和`lsof`深入分析该进程的行为

---

## 4. 💾 iotop磁盘IO监控


### 4.1 为什么要监控磁盘IO


**IO与网络的关系**：
很多时候网络慢不是因为网络本身，而是因为磁盘IO跟不上。比如：
- **下载文件时**：网络数据需要写入磁盘
- **数据库操作**：查询结果需要从磁盘读取后通过网络发送
- **日志写入**：网络服务的日志写入可能成为瓶颈

### 4.2 iotop使用方法


**安装方法**：
```bash
# CentOS/RHEL
yum install iotop

# Ubuntu/Debian
apt-get install iotop
```

**基本使用**：
```bash
# 基本监控
iotop

# 只显示有IO活动的进程
iotop -o

# 显示累积IO而不是当前IO
iotop -a

# 指定刷新间隔
iotop -d 2
```

**界面解读**：
```
iotop界面说明：
┌──────────────────────────────────────────────────────┐
│Total DISK READ:   12.34 MB/s | Total DISK WRITE: 5.67MB/s│
│Current DISK READ: 10.12 MB/s | Current DISK WRITE:4.56MB/s│
│────────────────────────────────────────────────────────│
│  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN   IO>  │
│ 1234  be/4  root     15.2 MB/s    0.0 MB/s   0.00%  99.9%│
│ 5678  be/4  mysql     2.1 MB/s   10.3 MB/s   0.00%  45.2%│
└──────────────────────────────────────────────────────────┘

关键指标说明：
- DISK READ：磁盘读取速度
- DISK WRITE：磁盘写入速度  
- SWAPIN：交换分区使用百分比
- IO>：IO等待百分比（越高说明磁盘越忙）
```

---

## 5. 📊 nload网络负载监控


### 5.1 nload特点


**什么是nload**：
`nload`提供了最直观的网络流量显示方式，用图形化的方式实时显示网络接口的流量情况，特别适合快速了解网络负载状况。

### 5.2 nload使用方法


**安装和基本使用**：
```bash
# 安装
apt-get install nload  # Ubuntu/Debian
yum install nload      # CentOS/RHEL

# 基本使用
nload

# 指定网络接口
nload eth0

# 同时监控多个接口
nload eth0 eth1
```

**界面特点**：
```
nload显示界面：
┌─────────────────────────────────────────────────┐
│Device eth0 [192.168.1.100] (1/1):              │
│═══════════════════════════════════════════════  │
│Incoming:                                        │
│████████████████████████████████████████   2.5MB/s│
│                                       Curr:  2.5MB/s│
│                                       Avg:   1.8MB/s│
│                                       Min:   0.1MB/s│
│                                       Max:   3.2MB/s│
│                                       Ttl:  156.7MB│
│                                                 │
│Outgoing:                                        │
│████████████                               0.8MB/s│
│                                       Curr:  0.8MB/s│
│                                       Avg:   0.6MB/s│  
│                                       Min:   0.0MB/s│
│                                       Max:   1.1MB/s│
│                                       Ttl:   45.2MB│
└─────────────────────────────────────────────────┘

优势：
✅ 图形化显示，直观易懂
✅ 同时显示多个统计指标
✅ 可以在多个网卡间切换
```

### 5.3 nload常用操作


**交互式控制**：
```
运行时按键操作：
- 方向键 ←→：在多个网络接口间切换
- Enter：刷新显示
- s：设置选项
- q：退出
```

---

## 6. 📈 vnstat网络流量统计


### 6.1 vnstat的价值


**长期统计的重要性**：
前面介绍的工具都是实时监控，但有时我们需要了解：
- **每天的流量使用情况**：判断是否有异常
- **月度流量统计**：制定带宽规划
- **历史趋势分析**：发现使用规律

`vnstat`就是专门解决这个问题的工具。

### 6.2 vnstat安装和初始化


**安装配置**：
```bash
# 安装
apt-get install vnstat  # Ubuntu/Debian
yum install vnstat      # CentOS/RHEL

# 初始化数据库（为指定网卡创建统计）
vnstat -u -i eth0

# 启动后台服务（持续统计）
systemctl start vnstat
systemctl enable vnstat
```

### 6.3 vnstat使用方法


**常用查询命令**：
```bash
# 显示基本统计信息
vnstat

# 显示每小时统计
vnstat -h

# 显示每日统计  
vnstat -d

# 显示每月统计
vnstat -m

# 显示指定网卡的统计
vnstat -i eth0

# 显示实时流量（类似nload）
vnstat -l
```

**输出示例解读**：
```
vnstat输出示例：
Database updated: 2025-09-18 14:30:00

   eth0 since 2025-09-01

          rx:  1.25 GiB      tx:  856.34 MiB      total:  2.09 GiB

                     rx      |     tx      |    total    |   avg. rate
     ------------------------+-------------+-------------+---------------
       yesterday     45.2 MB |    32.1 MB  |    77.3 MB  |    0.89 kBit/s  
           today     123.5MB |    89.2 MB  |   212.7 MB  |    2.46 kBit/s
     ------------------------+-------------+-------------+---------------
     estimated        180 MB |    130 MB   |    310 MB   |

说明：
- rx：接收的数据量（下载）
- tx：发送的数据量（上传）  
- total：总数据量
- avg. rate：平均速率
```

**高级用法**：
```bash
# 生成图形化报告（需要安装vnstati）
vnstati -s -i eth0 -o network_summary.png

# 导出数据（JSON格式）
vnstat --json

# 查看指定时间段的数据
vnstat --begin 2025-09-01 --end 2025-09-15
```

---

## 7. 🔬 tcpdump数据包捕获


### 7.1 tcpdump基本概念


**什么是tcpdump**：
`tcpdump`是网络诊断的"显微镜"，它能捕获网络中传输的每一个数据包，让你看到网络通信的细节。这对于网络故障诊断来说非常重要。

**使用场景**：
- **网络故障诊断**：查看连接是否正常建立
- **安全分析**：检查是否有恶意流量  
- **性能分析**：分析网络延迟和丢包
- **协议分析**：理解网络协议的工作过程

### 7.2 tcpdump基本用法


**基础语法**：
```bash
# 基本抓包（显示所有流量）
tcpdump

# 抓包并保存到文件
tcpdump -w capture.pcap

# 从文件读取分析
tcpdump -r capture.pcap

# 指定网络接口
tcpdump -i eth0

# 限制抓包数量
tcpdump -c 100
```

### 7.3 tcpdump过滤条件


**按主机过滤**：
```bash
# 只抓取特定主机的流量
tcpdump host 192.168.1.100

# 抓取来源或目标是指定主机的流量
tcpdump src host 192.168.1.100
tcpdump dst host 192.168.1.100
```

**按端口过滤**：
```bash
# 抓取HTTP流量
tcpdump port 80

# 抓取SSH流量  
tcpdump port 22

# 抓取多个端口
tcpdump port 80 or port 443
```

**按协议过滤**：
```bash
# 只抓TCP包
tcpdump tcp

# 只抓UDP包
tcpdump udp

# 只抓ICMP包（ping命令）
tcpdump icmp
```

**组合过滤条件**：
```bash
# 抓取特定主机的HTTP流量
tcpdump host 192.168.1.100 and port 80

# 抓取除SSH外的所有TCP流量
tcpdump tcp and not port 22

# 复杂过滤条件
tcpdump '(host 192.168.1.100 or host 192.168.1.101) and (port 80 or port 443)'
```

### 7.4 tcpdump实用示例


**网络连通性测试**：
```bash
# 在一个终端运行tcpdump监听ping
tcpdump icmp

# 在另一个终端执行ping
ping 192.168.1.1

# tcpdump输出会显示：
# 14:30:01.123456 IP 192.168.1.100 > 192.168.1.1: ICMP echo request
# 14:30:01.124789 IP 192.168.1.1 > 192.168.1.100: ICMP echo reply
```

**HTTP请求分析**：
```bash
# 抓取并显示HTTP请求内容
tcpdump -i eth0 -A port 80

# 输出会显示HTTP头信息：
# GET / HTTP/1.1
# Host: www.example.com  
# User-Agent: curl/7.58.0
```

> ⚠️ **使用注意**：
> - tcpdump需要root权限
> - 在生产环境使用时要小心，可能影响性能
> - 捕获的数据可能包含敏感信息，注意数据安全

---

## 8. 🛠️ tshark命令行抓包工具


### 8.1 tshark与tcpdump的区别


**工具对比**：
```
tcpdump vs tshark：

tcpdump：
✅ 系统自带，无需额外安装
✅ 轻量级，性能好
✅ 语法相对简单
❌ 分析功能相对有限

tshark：  
✅ 功能强大，分析能力强
✅ 支持更多协议解析
✅ 输出格式更灵活
❌ 需要额外安装
❌ 学习成本较高
```

### 8.2 tshark安装和基本使用


**安装方法**：
```bash
# Ubuntu/Debian
apt-get install tshark

# CentOS/RHEL
yum install wireshark-cli
```

**基本语法**：
```bash
# 基本抓包
tshark -i eth0

# 抓包保存到文件
tshark -i eth0 -w capture.pcapng

# 从文件读取
tshark -r capture.pcapng
```

### 8.3 tshark高级功能


**协议解析**：
```bash
# 只显示HTTP协议的详细信息
tshark -i eth0 -Y "http" -V

# 显示DNS查询
tshark -i eth0 -Y "dns"

# 显示TCP握手过程
tshark -i eth0 -Y "tcp.flags.syn==1"
```

**自定义输出格式**：
```bash
# 只显示特定字段
tshark -i eth0 -T fields -e ip.src -e ip.dst -e tcp.port

# 输出CSV格式
tshark -i eth0 -T fields -E separator=, -e ip.src -e ip.dst
```

**统计功能**：
```bash
# 统计各协议的数据包数量
tshark -r capture.pcapng -q -z io,phs

# 统计会话信息
tshark -r capture.pcapng -q -z conv,ip

# 统计响应时间
tshark -r capture.pcapng -q -z rtt,sip
```

---

## 9. 📋 核心要点总结


### 9.1 工具选择指南


**按使用场景选择**：
```
快速排查网络问题：
1. 先用 nload 看整体流量情况
2. 用 nethogs 找出具体是哪个进程
3. 用 iotop 检查是否IO瓶颈
4. 必要时用 tcpdump 深入分析

历史数据分析：
- 使用 vnstat 查看长期趋势

详细连接分析：  
- 使用 iftop 查看具体连接情况

数据包级别诊断：
- 简单问题用 tcpdump
- 复杂分析用 tshark
```

### 9.2 实用命令速查


**常用命令组合**：
```bash
# 网络问题诊断三步法
1. nload                    # 看总体负载
2. nethogs -s               # 找占用最多的进程  
3. iftop -n                 # 看具体连接

# 抓包分析模板
tcpdump -i eth0 -w problem.pcap host [目标IP] and port [端口]

# 长期监控设置
vnstat -u -i eth0           # 初始化统计
systemctl enable vnstat     # 启用服务
```

### 9.3 关键理解要点


**🔹 监控的层次性**
```
网络监控要分层次进行：
1. 整体层面：总流量是否正常
2. 进程层面：哪个程序在使用网络  
3. 连接层面：具体的网络连接情况
4. 数据包层面：协议级别的详细分析
```

**🔹 工具的互补性**  
```
没有一个工具能解决所有问题：
- 实时监控 + 历史统计 = 完整视角
- 高层概览 + 底层细节 = 准确诊断
- 多个工具配合使用效果最好
```

**🔹 性能与功能的平衡**
```
选择工具时要考虑：
- 简单问题用轻量级工具（nload, iftop）
- 复杂问题用功能强大工具（tshark）
- 生产环境优先考虑性能影响
```

### 9.4 实际应用价值


**日常运维场景**：
- **服务器性能监控**：定期检查网络使用情况
- **故障快速定位**：网络问题的第一时间诊断
- **容量规划**：基于历史数据制定网络规划
- **安全监控**：识别异常网络活动

**学习成长路径**：
- **入门阶段**：熟练使用nload、nethogs
- **进阶阶段**：掌握iftop、tcpdump
- **高级阶段**：深入使用tshark进行协议分析

> 🧠 **记忆要点**：
> - nload看总体，nethogs找进程  
> - iftop看连接，tcpdump抓细节
> - vnstat管历史，tshark做分析
> - 监控分层次，工具要配合

**核心价值**：掌握这些网络监控命令，让你在面对网络问题时不再束手无策，而是能够快速定位问题，精准解决故障。