---
title: 12ã€æœåŠ¡è°ƒè¯•ä¸æ•…éšœæ’æŸ¥
---
## ğŸ“š ç›®å½•

1. [æœåŠ¡è°ƒè¯•åŸºç¡€æ¦‚å¿µ](#1-æœåŠ¡è°ƒè¯•åŸºç¡€æ¦‚å¿µ)
2. [å¿«é€Ÿå®šä½å¤±è´¥æœåŠ¡](#2-å¿«é€Ÿå®šä½å¤±è´¥æœåŠ¡)
3. [ç³»ç»Ÿå¯åŠ¨æ€§èƒ½åˆ†æ](#3-ç³»ç»Ÿå¯åŠ¨æ€§èƒ½åˆ†æ)
4. [è¯¦ç»†é”™è¯¯ä¿¡æ¯æŸ¥çœ‹](#4-è¯¦ç»†é”™è¯¯ä¿¡æ¯æŸ¥çœ‹)
5. [æœåŠ¡çŠ¶æ€æ·±åº¦åˆ†æ](#5-æœåŠ¡çŠ¶æ€æ·±åº¦åˆ†æ)
6. [æœåŠ¡å´©æºƒåˆ†æ](#6-æœåŠ¡å´©æºƒåˆ†æ)
7. [è¿›ç¨‹çº§è°ƒè¯•æŠ€æœ¯](#7-è¿›ç¨‹çº§è°ƒè¯•æŠ€æœ¯)
8. [systemdå®ˆæŠ¤è¿›ç¨‹ç®¡ç†](#8-systemdå®ˆæŠ¤è¿›ç¨‹ç®¡ç†)
9. [ç»¼åˆæ•…éšœæ’æŸ¥æµç¨‹](#9-ç»¼åˆæ•…éšœæ’æŸ¥æµç¨‹)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ æœåŠ¡è°ƒè¯•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡è°ƒè¯•


**æœåŠ¡è°ƒè¯•**å°±åƒåŒ»ç”Ÿç»™ç—…äººçœ‹ç—…ä¸€æ ·ï¼Œå½“Linuxç³»ç»Ÿä¸­çš„æœåŠ¡å‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å„ç§"è¯Šæ–­å·¥å…·"æ¥æ‰¾å‡ºé—®é¢˜çš„æ ¹æºã€‚

```
æœåŠ¡é—®é¢˜çš„å¸¸è§è¡¨ç°ï¼š
ğŸ“ æœåŠ¡å¯åŠ¨å¤±è´¥
ğŸ“ æœåŠ¡è¿è¡Œç¼“æ…¢
ğŸ“ æœåŠ¡çªç„¶å´©æºƒ
ğŸ“ æœåŠ¡å“åº”å¼‚å¸¸
```

### 1.2 è°ƒè¯•å·¥å…·æ¦‚è§ˆ


Linuxæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è°ƒè¯•å·¥å…·é“¾ï¼š

```
è°ƒè¯•å·¥å…·åˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     å·¥å…·ç±»å‹        â”‚           å…·ä½“å·¥å…·           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœåŠ¡çŠ¶æ€æŸ¥çœ‹      â”‚  systemctl status           â”‚
â”‚   å¤±è´¥æœåŠ¡å®šä½      â”‚  systemctl --failed         â”‚
â”‚   æ€§èƒ½åˆ†æå·¥å…·      â”‚  systemd-analyze            â”‚
â”‚   æ—¥å¿—æŸ¥çœ‹å·¥å…·      â”‚  journalctl                 â”‚
â”‚   å´©æºƒåˆ†æå·¥å…·      â”‚  coredumpctl                â”‚
â”‚   è¿›ç¨‹è·Ÿè¸ªå·¥å…·      â”‚  strace                     â”‚
â”‚   å®ˆæŠ¤è¿›ç¨‹ç®¡ç†      â”‚  systemctl daemon-reexec    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 è°ƒè¯•æ€è·¯


**æ•…éšœæ’æŸ¥çš„åŸºæœ¬æ€è·¯**ï¼š
1. **å‘ç°é—®é¢˜** â†’ å“ªä¸ªæœåŠ¡æœ‰é—®é¢˜ï¼Ÿ
2. **å®šä½åŸå› ** â†’ ä¸ºä»€ä¹ˆå‡ºç°é—®é¢˜ï¼Ÿ
3. **åˆ†æå½±å“** â†’ é—®é¢˜å½±å“äº†ä»€ä¹ˆï¼Ÿ
4. **è§£å†³é—®é¢˜** â†’ å¦‚ä½•ä¿®å¤é—®é¢˜ï¼Ÿ

---

## 2. ğŸ” å¿«é€Ÿå®šä½å¤±è´¥æœåŠ¡


### 2.1 systemctl --failed å‘½ä»¤è¯¦è§£


`systemctl --failed`æ˜¯å¿«é€Ÿæ‰¾å‡ºæ‰€æœ‰å¤±è´¥æœåŠ¡çš„åˆ©å™¨ï¼Œå°±åƒåŒ»é™¢çš„ä½“æ£€æŠ¥å‘Šï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºå“ªé‡Œæœ‰é—®é¢˜ã€‚

```bash
# æŸ¥çœ‹æ‰€æœ‰å¤±è´¥çš„æœåŠ¡
systemctl --failed

# è¾“å‡ºç¤ºä¾‹ï¼š
  UNIT                    LOAD   ACTIVE SUB    DESCRIPTION
â— network-manager.service loaded failed failed NetworkManager
â— apache2.service        loaded failed failed Apache HTTP Server
```

**å‘½ä»¤å‚æ•°è¯¦è§£**ï¼š
- `--failed`: åªæ˜¾ç¤ºçŠ¶æ€ä¸º"failed"çš„å•å…ƒ
- `--state=failed`: ç­‰ä»·å†™æ³•
- `--no-pager`: ä¸ä½¿ç”¨åˆ†é¡µå™¨ç›´æ¥è¾“å‡º

### 2.2 å®é™…åº”ç”¨åœºæ™¯


```bash
# åœºæ™¯1ï¼šç³»ç»Ÿå¯åŠ¨åæ£€æŸ¥æ˜¯å¦æœ‰æœåŠ¡å¯åŠ¨å¤±è´¥
systemctl --failed

# åœºæ™¯2ï¼šç»“åˆgrepè¿‡æ»¤ç‰¹å®šæœåŠ¡ç±»å‹
systemctl --failed --type=service

# åœºæ™¯3ï¼šè·å–å¤±è´¥æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯
systemctl --failed --full
```

**ğŸ’¡ å®ç”¨æŠ€å·§**ï¼š
- å¼€æœºåç¬¬ä¸€æ—¶é—´è¿è¡Œæ­¤å‘½ä»¤æ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€
- ç»“åˆå®šæ—¶ä»»åŠ¡ç›‘æ§æœåŠ¡çŠ¶æ€å˜åŒ–
- é…åˆé‚®ä»¶é€šçŸ¥å®ç°æ•…éšœè‡ªåŠ¨æŠ¥è­¦

### 2.3 å¤±è´¥çŠ¶æ€çš„å«ä¹‰


```
æœåŠ¡å¤±è´¥çŠ¶æ€è§£é‡Šï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   çŠ¶æ€åç§°   â”‚               å«ä¹‰è¯´æ˜               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   failed     â”‚  æœåŠ¡å¯åŠ¨å¤±è´¥æˆ–è¿è¡Œæ—¶å´©æºƒ            â”‚
â”‚   inactive   â”‚  æœåŠ¡æœªè¿è¡Œï¼ˆå¯èƒ½æ˜¯æ­£å¸¸åœæ­¢ï¼‰        â”‚
â”‚   error      â”‚  æœåŠ¡é…ç½®é”™è¯¯æˆ–ä¾èµ–é—®é¢˜              â”‚
â”‚   timeout    â”‚  æœåŠ¡å¯åŠ¨æˆ–åœæ­¢è¶…æ—¶                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. âš¡ ç³»ç»Ÿå¯åŠ¨æ€§èƒ½åˆ†æ


### 3.1 systemd-analyze blame å¯åŠ¨è€—æ—¶åˆ†æ


`systemd-analyze blame`å°±åƒç§’è¡¨ä¸€æ ·ï¼Œç²¾ç¡®è®°å½•æ¯ä¸ªæœåŠ¡çš„å¯åŠ¨æ—¶é—´ï¼Œå¸®ä½ æ‰¾å‡ºæ‹–æ…¢ç³»ç»Ÿå¯åŠ¨çš„"ç½ªé­ç¥¸é¦–"ã€‚

```bash
# æŸ¥çœ‹æœåŠ¡å¯åŠ¨è€—æ—¶æ’è¡Œæ¦œ
systemd-analyze blame

# è¾“å‡ºç¤ºä¾‹ï¼š
         8.235s NetworkManager-wait-online.service
         2.253s mysql.service
         1.823s apache2.service
         1.344s plymouth-quit-wait.service
           856ms systemd-networkd.service
```

**è¾“å‡ºä¿¡æ¯è§£è¯»**ï¼š
- **æ—¶é—´åˆ—**ï¼šæœåŠ¡å¯åŠ¨èŠ±è´¹çš„æ—¶é—´
- **æœåŠ¡å**ï¼šå…·ä½“çš„æœåŠ¡å•å…ƒåç§°
- **æ’åºè§„åˆ™**ï¼šæŒ‰è€—æ—¶ä»é«˜åˆ°ä½æ’åˆ—

### 3.2 systemd-analyze critical-chain å…³é”®è·¯å¾„åˆ†æ


`critical-chain`æ˜¾ç¤ºç³»ç»Ÿå¯åŠ¨çš„å…³é”®è·¯å¾„ï¼Œå°±åƒGPSå¯¼èˆªæ˜¾ç¤ºæœ€çŸ­è·¯å¾„ä¸€æ ·ã€‚

```bash
# æŸ¥çœ‹å¯åŠ¨å…³é”®è·¯å¾„
systemd-analyze critical-chain

# è¾“å‡ºç¤ºä¾‹ï¼š
The time when unit became active or started is printed after the "@" character.
The time the unit took to start is printed after the "+" character.

graphical.target @2.843s
â””â”€multi-user.target @2.843s
  â””â”€mysql.service @590ms +2.253s
    â””â”€network.target @588ms
      â””â”€NetworkManager.service @135ms +452ms
```

**å…³é”®è·¯å¾„è§£è¯»**ï¼š
- `@æ—¶é—´`: æœåŠ¡å¼€å§‹å¯åŠ¨çš„æ—¶åˆ»
- `+æ—¶é—´`: æœåŠ¡å¯åŠ¨èŠ±è´¹çš„æ—¶é—´
- `â””â”€`: ä¾èµ–å…³ç³»çš„å±‚çº§ç»“æ„

### 3.3 å¯åŠ¨æ—¶é—´æ€»è§ˆ


```bash
# æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“å¯åŠ¨æ—¶é—´
systemd-analyze time

# è¾“å‡ºç¤ºä¾‹ï¼š
Startup finished in 1.234s (kernel) + 2.345s (initrd) + 15.678s (userspace) = 19.257s
graphical.target reached after 15.234s in userspace
```

**æ—¶é—´æ®µå«ä¹‰**ï¼š
- **kernel**: å†…æ ¸å¯åŠ¨æ—¶é—´
- **initrd**: åˆå§‹å†…å­˜ç›˜åŠ è½½æ—¶é—´  
- **userspace**: ç”¨æˆ·ç©ºé—´æœåŠ¡å¯åŠ¨æ—¶é—´

---

## 4. ğŸ“‹ è¯¦ç»†é”™è¯¯ä¿¡æ¯æŸ¥çœ‹


### 4.1 journalctl -xe è¯¦ç»†é”™è¯¯ä¿¡æ¯


`journalctl -xe`æ˜¯Linuxçš„"é»‘åŒ£å­"ï¼Œè®°å½•äº†ç³»ç»Ÿè¿è¡Œçš„æ‰€æœ‰ç»†èŠ‚ï¼Œç‰¹åˆ«æ˜¯é”™è¯¯å‘ç”Ÿæ—¶çš„è¯¦ç»†ä¿¡æ¯ã€‚

```bash
# æŸ¥çœ‹æœ€æ–°çš„è¯¦ç»†æ—¥å¿—ä¿¡æ¯
journalctl -xe

# å¸¸ç”¨å‚æ•°ç»„åˆ
journalctl -xe --no-pager          # ä¸ä½¿ç”¨åˆ†é¡µå™¨
journalctl -xe -n 50               # åªæ˜¾ç¤ºæœ€æ–°50è¡Œ
journalctl -xe --since "1 hour ago" # æ˜¾ç¤ºæœ€è¿‘1å°æ—¶çš„æ—¥å¿—
```

**å‚æ•°å«ä¹‰**ï¼š
- `-x`: æ˜¾ç¤ºè§£é‡Šæ€§æ–‡æœ¬å’Œæç¤ºä¿¡æ¯
- `-e`: è·³è½¬åˆ°æ—¥å¿—æœ«å°¾ï¼ˆæœ€æ–°å†…å®¹ï¼‰
- `--no-pager`: ä¸ä½¿ç”¨åˆ†é¡µå™¨ï¼Œç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯

### 4.2 é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—æŸ¥çœ‹


```bash
# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„è¯¦ç»†æ—¥å¿—
journalctl -xe -u apache2.service

# å®æ—¶ç›‘æ§æœåŠ¡æ—¥å¿—ï¼ˆç±»ä¼¼tail -fï¼‰
journalctl -xe -u apache2.service -f

# æŸ¥çœ‹æœåŠ¡çš„å®Œæ•´æ—¥å¿—å†å²
journalctl -xe -u apache2.service --since "2024-01-01"
```

### 4.3 æ—¥å¿—çº§åˆ«è¿‡æ»¤


```bash
# åªæŸ¥çœ‹é”™è¯¯çº§åˆ«çš„æ—¥å¿—
journalctl -xe -p err

# æ—¥å¿—çº§åˆ«è¯´æ˜
journalctl -xe -p emerg    # ç´§æ€¥
journalctl -xe -p alert    # è­¦æŠ¥  
journalctl -xe -p crit     # ä¸¥é‡é”™è¯¯
journalctl -xe -p err      # é”™è¯¯
journalctl -xe -p warning  # è­¦å‘Š
journalctl -xe -p info     # ä¿¡æ¯
journalctl -xe -p debug    # è°ƒè¯•
```

---

## 5. ğŸ” æœåŠ¡çŠ¶æ€æ·±åº¦åˆ†æ


### 5.1 systemctl status è¯¦ç»†çŠ¶æ€ä¿¡æ¯


`systemctl status`å°±åƒåŒ»ç”Ÿç»™ç—…äººåšå…¨èº«æ£€æŸ¥ä¸€æ ·ï¼Œæä¾›æœåŠ¡è¿è¡ŒçŠ¶æ€çš„å®Œæ•´ç”»åƒã€‚

```bash
# æŸ¥çœ‹æœåŠ¡çš„è¯¦ç»†çŠ¶æ€
systemctl status apache2.service

# è¾“å‡ºç¤ºä¾‹åˆ†æï¼š
â— apache2.service - Apache HTTP Server
   Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
   Active: active (running) since Mon 2024-01-21 10:30:15 CST; 2h 15min ago
     Docs: https://httpd.apache.org/docs/2.4/
  Process: 1234 (code=exited, status=0/SUCCESS)
 Main PID: 5678 (apache2)
    Tasks: 55 (limit: 4915)
   Memory: 125.4M
   CGroup: /system.slice/apache2.service
           â”œâ”€5678 /usr/sbin/apache2 -DFOREGROUND
           â”œâ”€5679 /usr/sbin/apache2 -DFOREGROUND
           â””â”€5680 /usr/sbin/apache2 -DFOREGROUND
```

**çŠ¶æ€ä¿¡æ¯è¯¦è§£**ï¼š

```
çŠ¶æ€å­—æ®µè§£é‡Šï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å­—æ®µ     â”‚               å«ä¹‰è¯´æ˜               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Loaded    â”‚  æœåŠ¡å•å…ƒæ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½            â”‚
â”‚   Active    â”‚  æœåŠ¡å½“å‰è¿è¡ŒçŠ¶æ€                    â”‚
â”‚   Docs      â”‚  æœåŠ¡ç›¸å…³æ–‡æ¡£é“¾æ¥                    â”‚
â”‚   Process   â”‚  æœ€è¿‘çš„è¿›ç¨‹æ‰§è¡Œä¿¡æ¯                  â”‚
â”‚  Main PID   â”‚  ä¸»è¿›ç¨‹ID                           â”‚
â”‚   Tasks     â”‚  å½“å‰ä»»åŠ¡/çº¿ç¨‹æ•°é‡                   â”‚
â”‚   Memory    â”‚  å†…å­˜ä½¿ç”¨æƒ…å†µ                       â”‚
â”‚   CGroup    â”‚  æ§åˆ¶ç»„ä¿¡æ¯å’Œè¿›ç¨‹æ ‘                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 çŠ¶æ€åˆ¤æ–­æŠ€å·§


```bash
# å¿«é€Ÿåˆ¤æ–­æœåŠ¡æ˜¯å¦æ­£å¸¸
systemctl is-active apache2.service    # è¾“å‡ºï¼šactive/inactive
systemctl is-enabled apache2.service   # è¾“å‡ºï¼šenabled/disabled
systemctl is-failed apache2.service    # è¾“å‡ºï¼šfailedæˆ–å…¶ä»–çŠ¶æ€
```

**çŠ¶æ€ç»„åˆç†è§£**ï¼š
- `active (running)`: æ­£å¸¸è¿è¡Œä¸­ âœ…
- `active (exited)`: ä¸€æ¬¡æ€§ä»»åŠ¡å·²å®Œæˆ âœ…
- `inactive (dead)`: å·²åœæ­¢ âš ï¸
- `failed`: å¯åŠ¨å¤±è´¥æˆ–å´©æºƒ âŒ

---

## 6. ğŸ’¥ æœåŠ¡å´©æºƒåˆ†æ


### 6.1 coredumpctl æœåŠ¡å´©æºƒåˆ†æ


å½“æœåŠ¡å´©æºƒæ—¶ï¼Œ`coredumpctl`å°±åƒé£æœºå¤±äº‹åçš„é»‘åŒ£å­åˆ†æï¼Œå¸®ä½ æ‰¾å‡ºå´©æºƒçš„åŸå› ã€‚

```bash
# æŸ¥çœ‹æ‰€æœ‰æ ¸å¿ƒè½¬å‚¨
coredumpctl list

# è¾“å‡ºç¤ºä¾‹ï¼š
TIME                            PID   UID   GID SIG COREFILE  EXE
Mon 2024-01-21 10:15:23 CST    1234  1000  1000  11 present   /usr/bin/myapp
Mon 2024-01-21 09:45:12 CST    5678     0     0   6 present   /usr/sbin/apache2
```

### 6.2 å´©æºƒä¿¡æ¯è¯¦ç»†åˆ†æ


```bash
# æŸ¥çœ‹æœ€æ–°çš„å´©æºƒä¿¡æ¯
coredumpctl info

# æŸ¥çœ‹ç‰¹å®šPIDçš„å´©æºƒä¿¡æ¯
coredumpctl info 1234

# è¾“å‡ºç¤ºä¾‹ï¼š
           PID: 1234 (myapp)
           UID: 1000 (user)
           GID: 1000 (user)
        Signal: 11 (SEGV)
     Timestamp: Mon 2024-01-21 10:15:23 CST
  Command Line: /usr/bin/myapp --config /etc/myapp/config
    Executable: /usr/bin/myapp
 Control Group: /user.slice/user-1000.slice/session-3.scope
          Unit: session-3.scope
```

**ä¿¡å·å«ä¹‰è§£é‡Š**ï¼š

```
å¸¸è§å´©æºƒä¿¡å·ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¿¡å·   â”‚    åç§°      â”‚         å«ä¹‰è¯´æ˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   6     â”‚    SIGABRT   â”‚  ç¨‹åºä¸»åŠ¨ä¸­æ­¢           â”‚
â”‚   9     â”‚    SIGKILL   â”‚  å¼ºåˆ¶æ€æ­»è¿›ç¨‹           â”‚
â”‚   11    â”‚    SIGSEGV   â”‚  æ®µé”™è¯¯ï¼ˆå†…å­˜è®¿é—®è¿è§„ï¼‰  â”‚
â”‚   15    â”‚    SIGTERM   â”‚  æ­£å¸¸ç»ˆæ­¢è¯·æ±‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶åˆ†æ


```bash
# ä½¿ç”¨gdbåˆ†ææ ¸å¿ƒè½¬å‚¨æ–‡ä»¶
coredumpctl debug 1234

# æˆ–è€…æ‰‹åŠ¨æå–è½¬å‚¨æ–‡ä»¶
coredumpctl dump 1234 -o /tmp/core.1234
gdb /usr/bin/myapp /tmp/core.1234
```

---

## 7. ğŸ”¬ è¿›ç¨‹çº§è°ƒè¯•æŠ€æœ¯


### 7.1 strace -p è¿›ç¨‹ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ª


`strace`å°±åƒç»™è¿›ç¨‹å®‰è£…äº†"ç›‘æ§æ‘„åƒå¤´"ï¼Œè®°å½•è¿›ç¨‹çš„æ¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨åŠ¨ä½œã€‚

```bash
# è·Ÿè¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹
strace -p 1234

# å¸¸ç”¨å‚æ•°ç»„åˆ
strace -p 1234 -f          # åŒæ—¶è·Ÿè¸ªå­è¿›ç¨‹
strace -p 1234 -e file     # åªè·Ÿè¸ªæ–‡ä»¶ç›¸å…³è°ƒç”¨
strace -p 1234 -e network  # åªè·Ÿè¸ªç½‘ç»œç›¸å…³è°ƒç”¨
strace -p 1234 -o /tmp/trace.log  # è¾“å‡ºåˆ°æ–‡ä»¶
```

### 7.2 ç³»ç»Ÿè°ƒç”¨åˆ†æ


```bash
# è·Ÿè¸ªæœåŠ¡å¯åŠ¨è¿‡ç¨‹
strace -f -e trace=file systemctl start myservice

# è¾“å‡ºç¤ºä¾‹ï¼š
[pid 1234] openat(AT_FDCWD, "/etc/myservice/config", O_RDONLY) = 3
[pid 1234] read(3, "host=localhost\nport=8080\n", 4096) = 26
[pid 1234] close(3) = 0
[pid 1234] socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) = 4
[pid 1234] bind(4, {sa_family=AF_INET, sin_port=htons(8080)}, 16) = -1 EADDRINUSE
```

**ç³»ç»Ÿè°ƒç”¨ç±»å‹**ï¼š

```
å¸¸è§ç³»ç»Ÿè°ƒç”¨åˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç±»å‹     â”‚               ç¤ºä¾‹è°ƒç”¨               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡ä»¶æ“ä½œ   â”‚  open, read, write, close           â”‚
â”‚  ç½‘ç»œæ“ä½œ   â”‚  socket, bind, listen, accept       â”‚
â”‚  è¿›ç¨‹ç®¡ç†   â”‚  fork, exec, wait, kill             â”‚
â”‚  å†…å­˜ç®¡ç†   â”‚  mmap, munmap, brk                  â”‚
â”‚  ä¿¡å·å¤„ç†   â”‚  signal, sigaction, kill            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 å®ç”¨è°ƒè¯•æŠ€å·§


```bash
# æŸ¥æ‰¾è¿›ç¨‹æ— æ³•å¯åŠ¨çš„åŸå› 
strace -f -e trace=file,network systemctl start apache2 2>&1 | grep -E "(ENOENT|EACCES|EADDRINUSE)"

# ç›‘æ§æœåŠ¡çš„æ–‡ä»¶è®¿é—®
strace -p $(pgrep apache2 | head -1) -e trace=file -o apache_file_access.log

# åˆ†ææœåŠ¡ç½‘ç»œè¡Œä¸º
strace -p $(pgrep apache2 | head -1) -e trace=network
```

---

## 8. ğŸ”„ systemdå®ˆæŠ¤è¿›ç¨‹ç®¡ç†


### 8.1 systemctl daemon-reexec é‡æ–°æ‰§è¡Œ


`daemon-reexec`å°±åƒé‡å¯systemdå®ˆæŠ¤è¿›ç¨‹ï¼Œä½†ä¸å½±å“æ­£åœ¨è¿è¡Œçš„æœåŠ¡ï¼Œç±»ä¼¼äº"çƒ­é‡å¯"ã€‚

```bash
# é‡æ–°æ‰§è¡Œsystemdå®ˆæŠ¤è¿›ç¨‹
systemctl daemon-reexec
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- systemdé…ç½®æ–‡ä»¶ä¿®æ”¹åéœ€è¦é‡æ–°åŠ è½½
- systemdæœ¬èº«å‡ºç°å¼‚å¸¸ä½†ä¸æƒ³é‡å¯ç³»ç»Ÿ
- æ›´æ–°systemdç‰ˆæœ¬åéœ€è¦é‡æ–°åˆå§‹åŒ–

### 8.2 å…¶ä»–å®ˆæŠ¤è¿›ç¨‹ç®¡ç†å‘½ä»¤


```bash
# é‡æ–°åŠ è½½systemdé…ç½®æ–‡ä»¶
systemctl daemon-reload

# æŸ¥çœ‹systemdå®ˆæŠ¤è¿›ç¨‹çŠ¶æ€
systemctl status systemd

# æ£€æŸ¥systemdé…ç½®æ–‡ä»¶è¯­æ³•
systemd-analyze verify /etc/systemd/system/myservice.service
```

### 8.3 å®ˆæŠ¤è¿›ç¨‹é…ç½®ä¼˜åŒ–


**systemdé…ç½®è°ƒä¼˜**ï¼š

```bash
# æŸ¥çœ‹systemdé…ç½®
systemctl show-environment

# è®¾ç½®systemdç¯å¢ƒå˜é‡
systemctl set-environment SYSTEMD_LOG_LEVEL=debug

# é‡ç½®systemdç¯å¢ƒå˜é‡
systemctl unset-environment SYSTEMD_LOG_LEVEL
```

---

## 9. ğŸ”§ ç»¼åˆæ•…éšœæ’æŸ¥æµç¨‹


### 9.1 æ ‡å‡†æ’æŸ¥æ­¥éª¤


```
æ•…éšœæ’æŸ¥æµç¨‹å›¾ï¼š

é—®é¢˜å‘ç°
    â†“
å¿«é€Ÿè¯„ä¼° â†’ systemctl --failed
    â†“
çŠ¶æ€åˆ†æ â†’ systemctl status [service]
    â†“
æ—¥å¿—æŸ¥çœ‹ â†’ journalctl -xe -u [service]
    â†“
æ€§èƒ½åˆ†æ â†’ systemd-analyze blame/critical-chain
    â†“
æ·±åº¦è°ƒè¯• â†’ strace/coredumpctl
    â†“
é—®é¢˜è§£å†³ â†’ ä¿®å¤é…ç½®/é‡å¯æœåŠ¡
    â†“
éªŒè¯ç»“æœ â†’ å†æ¬¡æ£€æŸ¥çŠ¶æ€å’Œæ—¥å¿—
```

### 9.2 å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º


**æ¡ˆä¾‹ï¼šApacheæœåŠ¡å¯åŠ¨å¤±è´¥**

```bash
# æ­¥éª¤1ï¼šå‘ç°é—®é¢˜
systemctl --failed
# è¾“å‡ºï¼šâ— apache2.service loaded failed failed Apache HTTP Server

# æ­¥éª¤2ï¼šæŸ¥çœ‹è¯¦ç»†çŠ¶æ€
systemctl status apache2.service
# æ˜¾ç¤ºï¼šProcess: 1234 (code=exited, status=1/FAILURE)

# æ­¥éª¤3ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—
journalctl -xe -u apache2.service
# å‘ç°ï¼šç«¯å£80è¢«å ç”¨

# æ­¥éª¤4ï¼šç¡®è®¤ç«¯å£å ç”¨
netstat -tlnp | grep :80
# å‘ç°ï¼šnginxæ­£åœ¨ä½¿ç”¨80ç«¯å£

# æ­¥éª¤5ï¼šè§£å†³é—®é¢˜
systemctl stop nginx
systemctl start apache2

# æ­¥éª¤6ï¼šéªŒè¯ç»“æœ
systemctl status apache2.service
# ç¡®è®¤ï¼šactive (running)
```

### 9.3 å¸¸è§é—®é¢˜è§£å†³æ¨¡æ¿


```
é—®é¢˜ç±»å‹ä¸è§£å†³æ–¹æ¡ˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     é—®é¢˜ç±»å‹    â”‚            è§£å†³æ€è·¯                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å¯åŠ¨å¤±è´¥      â”‚  æ£€æŸ¥é…ç½®æ–‡ä»¶ã€ä¾èµ–å…³ç³»ã€æƒé™      â”‚
â”‚   ç«¯å£å†²çª      â”‚  æŸ¥çœ‹ç«¯å£å ç”¨ã€ä¿®æ”¹é…ç½®ã€åœæ­¢å†²çª  â”‚
â”‚   æƒé™é—®é¢˜      â”‚  æ£€æŸ¥æ–‡ä»¶æƒé™ã€ç”¨æˆ·ç»„ã€SELinux     â”‚
â”‚   ä¾èµ–ç¼ºå¤±      â”‚  å®‰è£…ä¾èµ–åŒ…ã€å¯åŠ¨ä¾èµ–æœåŠ¡          â”‚
â”‚   é…ç½®é”™è¯¯      â”‚  æ£€æŸ¥è¯­æ³•ã€è·¯å¾„ã€å‚æ•°è®¾ç½®          â”‚
â”‚   èµ„æºä¸è¶³      â”‚  æ£€æŸ¥å†…å­˜ã€ç£ç›˜ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå‘½ä»¤


```bash
# æœåŠ¡çŠ¶æ€æ£€æŸ¥ä¸‰å‰‘å®¢
systemctl --failed              # å¿«é€Ÿå‘ç°å¤±è´¥æœåŠ¡
systemctl status [service]      # æŸ¥çœ‹è¯¦ç»†çŠ¶æ€ä¿¡æ¯  
journalctl -xe -u [service]     # æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

# æ€§èƒ½åˆ†æåŒé›„
systemd-analyze blame           # å¯åŠ¨è€—æ—¶åˆ†æ
systemd-analyze critical-chain  # å¯åŠ¨å…³é”®è·¯å¾„

# æ·±åº¦è°ƒè¯•å·¥å…·
coredumpctl list                # æŸ¥çœ‹å´©æºƒè½¬å‚¨
strace -p [PID]                 # è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨

# å®ˆæŠ¤è¿›ç¨‹ç®¡ç†
systemctl daemon-reexec         # é‡æ–°æ‰§è¡Œsystemd
systemctl daemon-reload         # é‡æ–°åŠ è½½é…ç½®
```

### 10.2 æ•…éšœæ’æŸ¥é»„é‡‘æ³•åˆ™


**ğŸ”¸ é—®é¢˜å®šä½æ³•åˆ™**ï¼š
- å…ˆçœ‹`--failed`ï¼Œå¿«é€Ÿå®šä½é—®é¢˜æœåŠ¡
- å†ç”¨`status`ï¼Œäº†è§£æœåŠ¡è¯¦ç»†çŠ¶æ€
- ç„¶åæŸ¥`journalctl`ï¼Œåˆ†æé”™è¯¯åŸå› 
- æœ€åç”¨ä¸“ä¸šå·¥å…·æ·±åº¦åˆ†æ

**ğŸ”¸ è°ƒè¯•æ•ˆç‡æå‡**ï¼š
- å–„ç”¨å‚æ•°ç»„åˆæé«˜æŸ¥è¯¢ç²¾åº¦
- ç»“åˆgrepç­‰å·¥å…·è¿‡æ»¤å…³é”®ä¿¡æ¯
- å»ºç«‹ä¸ªäººè°ƒè¯•å‘½ä»¤å¤‡å¿˜å½•
- å…»æˆå®šæœŸæ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€çš„ä¹ æƒ¯

### 10.3 å®è·µå»ºè®®


**ğŸ’¡ æ—¥å¸¸ç»´æŠ¤ä¹ æƒ¯**ï¼š
- æ¯å¤©æ£€æŸ¥`systemctl --failed`
- å®šæœŸåˆ†æç³»ç»Ÿå¯åŠ¨æ€§èƒ½
- é‡è¦æœåŠ¡é…ç½®å®æ—¶ç›‘æ§
- å»ºç«‹æ•…éšœå¤„ç†æ ‡å‡†æµç¨‹

**âš ï¸ è°ƒè¯•æ³¨æ„äº‹é¡¹**ï¼š
- è°ƒè¯•è¿‡ç¨‹ä¸­é¿å…é‡å¤é‡å¯æœåŠ¡
- straceè·Ÿè¸ªä¼šå½±å“æ€§èƒ½ï¼Œè°¨æ…åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
- æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæ³¨æ„å®‰å…¨
- ä¿®æ”¹systemdé…ç½®åè®°å¾—daemon-reload

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æœåŠ¡è°ƒè¯•ä»`--failed`å¼€å§‹ï¼Œç”¨`status`æ·±å…¥ï¼Œé `journalctl`å®šä½
- æ€§èƒ½åˆ†æé `systemd-analyze`ï¼Œå´©æºƒè°ƒè¯•ç”¨`coredumpctl`
- è¿›ç¨‹è·Ÿè¸ªç”¨`strace`ï¼Œå®ˆæŠ¤è¿›ç¨‹ç®¡ç†æ‰¾`daemon-reexec`
- æ•…éšœæ’æŸ¥æœ‰æµç¨‹ï¼Œå·¥å…·é…åˆæ•ˆç‡é«˜