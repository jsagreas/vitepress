---
title: 6ã€æœåŠ¡å¯åŠ¨ç±»å‹ä¸æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [æœåŠ¡å¯åŠ¨ç±»å‹æ¦‚è¿°](#1-æœåŠ¡å¯åŠ¨ç±»å‹æ¦‚è¿°)
2. [Typeå¯åŠ¨ç±»å‹è¯¦è§£](#2-Typeå¯åŠ¨ç±»å‹è¯¦è§£)
3. [é‡å¯ç­–ç•¥é…ç½®](#3-é‡å¯ç­–ç•¥é…ç½®)
4. [æœåŠ¡ä¾èµ–ä¸é¡ºåº](#4-æœåŠ¡ä¾èµ–ä¸é¡ºåº)
5. [æ‰§è¡Œç¯å¢ƒé…ç½®](#5-æ‰§è¡Œç¯å¢ƒé…ç½®)
6. [å®æˆ˜é…ç½®ç¤ºä¾‹](#6-å®æˆ˜é…ç½®ç¤ºä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æœåŠ¡å¯åŠ¨ç±»å‹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡å¯åŠ¨ç±»å‹


åœ¨Linuxç³»ç»Ÿä¸­ï¼Œ**æœåŠ¡å¯åŠ¨ç±»å‹**å°±æ˜¯å‘Šè¯‰systemd"è¿™ä¸ªç¨‹åºæ˜¯æ€ä¹ˆè¿è¡Œçš„"ã€‚å°±åƒä¸åŒçš„ç¨‹åºæœ‰ä¸åŒçš„è¿è¡Œæ–¹å¼ï¼š

ğŸŒ° **ç”Ÿæ´»ç±»æ¯”**: 
- æœ‰äº›ç¨‹åºåƒ**é¤å…æœåŠ¡å‘˜**ï¼Œå¯åŠ¨åä¸€ç›´åœ¨é‚£é‡Œç­‰å¾…é¡¾å®¢(simpleç±»å‹)
- æœ‰äº›ç¨‹åºåƒ**å¿«é€’å‘˜**ï¼Œé€å®Œå¿«é€’å°±èµ°äº†(oneshotç±»å‹)  
- æœ‰äº›ç¨‹åºåƒ**åº—é•¿**ï¼Œå…ˆåŸ¹è®­å‡ ä¸ªå‘˜å·¥ï¼Œç„¶åè‡ªå·±å»ç®¡ç†(forkingç±»å‹)

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä¸åŒçš„å¯åŠ¨ç±»å‹


```
ä¸åŒç¨‹åºçš„è¿è¡Œç‰¹ç‚¹ï¼š

WebæœåŠ¡å™¨ â†’ å¯åŠ¨åæŒç»­è¿è¡Œï¼Œå¤„ç†è¯·æ±‚
å¤‡ä»½è„šæœ¬ â†’ æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡å°±ç»“æŸ
æ•°æ®åº“   â†’ å¯åŠ¨æ—¶åˆ›å»ºå¤šä¸ªå·¥ä½œè¿›ç¨‹
```

systemdéœ€è¦çŸ¥é“æ¯ä¸ªç¨‹åºçš„ç‰¹ç‚¹ï¼Œæ‰èƒ½æ­£ç¡®åœ°ç®¡ç†å®ƒä»¬ã€‚

### 1.3 æœåŠ¡é…ç½®æ–‡ä»¶ä½ç½®


systemdæœåŠ¡é…ç½®æ–‡ä»¶ä¸»è¦å­˜æ”¾åœ¨è¿™äº›åœ°æ–¹ï¼š

```
ç³»ç»ŸæœåŠ¡ç›®å½•ç»“æ„ï¼š
/etc/systemd/system/     â† ç®¡ç†å‘˜è‡ªå®šä¹‰æœåŠ¡
/usr/lib/systemd/system/ â† è½¯ä»¶åŒ…å®‰è£…çš„æœåŠ¡
/run/systemd/system/     â† è¿è¡Œæ—¶ä¸´æ—¶æœåŠ¡

ä¼˜å…ˆçº§ï¼š/etc > /run > /usr/lib
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> systemdä¼šæŒ‰ä¼˜å…ˆçº§æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼Œ/etcç›®å½•çš„é…ç½®ä¼šè¦†ç›–å…¶ä»–ä½ç½®çš„åŒåé…ç½®

---

## 2. âš™ï¸ Typeå¯åŠ¨ç±»å‹è¯¦è§£


### 2.1 Type=simple - ç®€å•ç›´æ¥å‹


**å«ä¹‰**: ç¨‹åºå¯åŠ¨åå°±ä¸€ç›´è¿è¡Œï¼Œä¸ä¼šé€€å‡ºåˆ°åå°

**ç‰¹ç‚¹**:
- ğŸ”¸ **æœ€å¸¸ç”¨çš„ç±»å‹**ï¼Œé»˜è®¤è®¾ç½®
- ğŸ”¸ **å‰å°è¿è¡Œ**ï¼Œä¸ä¼šåˆ›å»ºå­è¿›ç¨‹
- ğŸ”¸ systemdå¯åŠ¨ç¨‹åºå**ç«‹å³è®¤ä¸ºå¯åŠ¨æˆåŠŸ**

```ini
[Unit]
Description=ç®€å•WebæœåŠ¡
After=network.target

[Service]
Type=simple
ExecStart=/usr/bin/python3 /opt/webapp/app.py
Restart=always

[Install]  
WantedBy=multi-user.target
```

**é€‚ç”¨åœºæ™¯**:
- WebæœåŠ¡å™¨ç¨‹åº
- æ•°æ®åº“æœåŠ¡
- å„ç§å®ˆæŠ¤è¿›ç¨‹

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> simpleç±»å‹çš„ç¨‹åºä¸èƒ½ä½¿ç”¨daemon()å‡½æ•°è®©è‡ªå·±å˜æˆåå°è¿›ç¨‹ï¼Œå¦åˆ™systemdä¼šè®¤ä¸ºç¨‹åºå¼‚å¸¸é€€å‡º

### 2.2 Type=forking - çˆ¶å­è¿›ç¨‹å‹


**å«ä¹‰**: ç¨‹åºå¯åŠ¨æ—¶ä¼š**åˆ›å»ºå­è¿›ç¨‹**ï¼Œç„¶å**çˆ¶è¿›ç¨‹é€€å‡º**ï¼Œå­è¿›ç¨‹ç»§ç»­è¿è¡Œ

**å·¥ä½œåŸç†**:
```
systemdå¯åŠ¨ç¨‹åº â†’ ç¨‹åºåˆ›å»ºå­è¿›ç¨‹ â†’ çˆ¶è¿›ç¨‹é€€å‡º â†’ systemdç®¡ç†å­è¿›ç¨‹
```

```ini
[Unit]
Description=ä¼ ç»Ÿå®ˆæŠ¤è¿›ç¨‹
After=network.target

[Service]
Type=forking
ExecStart=/usr/sbin/nginx
PIDFile=/var/run/nginx.pid
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

**å…³é”®é…ç½®**:
- **PIDFile**: æŒ‡å®šå­è¿›ç¨‹çš„PIDæ–‡ä»¶ä½ç½®ï¼Œè®©systemdçŸ¥é“è¦ç®¡ç†å“ªä¸ªè¿›ç¨‹
- **ExecStart**: å¯åŠ¨å‘½ä»¤ä¸èƒ½ä½¿ç”¨åå°è¿è¡Œå‚æ•°(å¦‚&)

**é€‚ç”¨åœºæ™¯**:
- ä¼ ç»Ÿçš„Unixå®ˆæŠ¤è¿›ç¨‹
- Nginxã€Apacheç­‰WebæœåŠ¡å™¨
- å¾ˆå¤šCè¯­è¨€ç¼–å†™çš„ç³»ç»ŸæœåŠ¡

> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> forkingç±»å‹ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹ä¼ ç»Ÿçš„Unixå®ˆæŠ¤è¿›ç¨‹ï¼Œè¿™äº›ç¨‹åºä¹ æƒ¯è‡ªå·±forkå­è¿›ç¨‹

### 2.3 Type=oneshot - ä¸€æ¬¡æ€§ä»»åŠ¡å‹


**å«ä¹‰**: ç¨‹åº**æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡å°±é€€å‡º**ï¼Œsystemdç­‰å¾…ç¨‹åºå®Œæˆ

**ç‰¹ç‚¹**:
- ğŸ”¸ **ä»»åŠ¡å®Œæˆåç¨‹åºé€€å‡º**
- ğŸ”¸ systemd**ç­‰å¾…ç¨‹åºæ‰§è¡Œå®Œæ¯•**
- ğŸ”¸ é€šå¸¸é…åˆ**RemainAfterExit=yes**ä½¿ç”¨

```ini
[Unit]
Description=ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬
After=local-fs.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/system-init.sh
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
```

**RemainAfterExit=yesçš„ä½œç”¨**:
- å³ä½¿ç¨‹åºé€€å‡ºäº†ï¼Œsystemdä»ç„¶è®¤ä¸ºæœåŠ¡æ˜¯"è¿è¡Œä¸­"çŠ¶æ€
- è¿™æ ·å¯ä»¥æ­£ç¡®å¤„ç†æœåŠ¡çš„ä¾èµ–å…³ç³»

**é€‚ç”¨åœºæ™¯**:
- ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬
- ä¸€æ¬¡æ€§é…ç½®ä»»åŠ¡
- æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ
- ç½‘ç»œé…ç½®è„šæœ¬

### 2.4 Type=notify - é€šçŸ¥ç¡®è®¤å‹


**å«ä¹‰**: ç¨‹åºå¯åŠ¨åä¼š**ä¸»åŠ¨é€šçŸ¥systemd**è‡ªå·±å·²ç»å‡†å¤‡å¥½äº†

**å·¥ä½œæµç¨‹**:
```
systemdå¯åŠ¨ç¨‹åº â†’ ç¨‹åºåˆå§‹åŒ– â†’ ç¨‹åºå‘é€READYæ¶ˆæ¯ â†’ systemdç¡®è®¤å¯åŠ¨æˆåŠŸ
```

```ini
[Unit]
Description=æ”¯æŒnotifyçš„æœåŠ¡
After=network.target

[Service]
Type=notify
ExecStart=/usr/bin/myservice
NotifyAccess=main
Restart=always

[Install]
WantedBy=multi-user.target
```

**ç¨‹åºè¦æ±‚**:
- ç¨‹åºå¿…é¡»ä½¿ç”¨**sd_notify()å‡½æ•°**å‘systemdå‘é€çŠ¶æ€
- æˆ–è€…ä½¿ç”¨**systemd-notifyå‘½ä»¤**

**é€‚ç”¨åœºæ™¯**:
- systemdåŸç”Ÿæ”¯æŒçš„ç°ä»£ç¨‹åº
- éœ€è¦å¤æ‚åˆå§‹åŒ–è¿‡ç¨‹çš„æœåŠ¡
- è¦æ±‚ç²¾ç¡®æ§åˆ¶å¯åŠ¨æ—¶æœºçš„æœåŠ¡

---

## 3. ğŸ”„ é‡å¯ç­–ç•¥é…ç½®


### 3.1 Restarté‡å¯ç­–ç•¥è¯¦è§£


**Restart**å‚æ•°æ§åˆ¶æœåŠ¡**ä»€ä¹ˆæ—¶å€™è‡ªåŠ¨é‡å¯**:

| é‡å¯ç­–ç•¥ | **è§¦å‘æ¡ä»¶** | **ä½¿ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| `no` | **æ°¸ä¸é‡å¯** | `ä¸€æ¬¡æ€§ä»»åŠ¡ã€æµ‹è¯•æœåŠ¡` |
| `always` | **æ€»æ˜¯é‡å¯** | `å…³é”®ç³»ç»ŸæœåŠ¡ã€WebæœåŠ¡` |
| `on-success` | **æ­£å¸¸é€€å‡ºæ—¶é‡å¯** | `å‘¨æœŸæ€§ä»»åŠ¡` |
| `on-failure` | **å¼‚å¸¸é€€å‡ºæ—¶é‡å¯** | `å¤§éƒ¨åˆ†åº”ç”¨æœåŠ¡` |
| `on-abnormal` | **å¼‚å¸¸ä¿¡å·æ—¶é‡å¯** | `ç‰¹æ®Šå®ˆæŠ¤è¿›ç¨‹` |

### 3.2 é‡å¯ç­–ç•¥å®é™…åº”ç”¨


**ğŸ”¸ å…³é”®æœåŠ¡é…ç½®**:
```ini
[Service]
Type=simple
ExecStart=/usr/bin/web-server
Restart=always
RestartSec=5s
```
> å«ä¹‰: æ— è®ºä»€ä¹ˆåŸå› é€€å‡ºï¼Œéƒ½è¦é‡å¯ï¼Œç­‰å¾…5ç§’å†é‡å¯

**ğŸ”¸ æ™®é€šåº”ç”¨é…ç½®**:
```ini
[Service]
Type=simple
ExecStart=/usr/bin/my-app
Restart=on-failure
RestartSec=10s
StartLimitBurst=3
StartLimitIntervalSec=60s
```
> å«ä¹‰: åªæœ‰å¼‚å¸¸é€€å‡ºæ‰é‡å¯ï¼Œ1åˆ†é’Ÿå†…æœ€å¤šé‡å¯3æ¬¡

### 3.3 é‡å¯é™åˆ¶å‚æ•°


**é˜²æ­¢æ— é™é‡å¯å¾ªç¯**:

- **RestartSec**: é‡å¯å‰ç­‰å¾…æ—¶é—´
- **StartLimitBurst**: é™åˆ¶æ—¶é—´å†…æœ€å¤§é‡å¯æ¬¡æ•°  
- **StartLimitIntervalSec**: é™åˆ¶æ—¶é—´çª—å£

```
é‡å¯ä¿æŠ¤æœºåˆ¶ç¤ºä¾‹ï¼š
æœåŠ¡å¼‚å¸¸é€€å‡º â†’ ç­‰å¾…10ç§’ â†’ é‡å¯(ç¬¬1æ¬¡)
å†æ¬¡å¼‚å¸¸é€€å‡º â†’ ç­‰å¾…10ç§’ â†’ é‡å¯(ç¬¬2æ¬¡)  
å†æ¬¡å¼‚å¸¸é€€å‡º â†’ ç­‰å¾…10ç§’ â†’ é‡å¯(ç¬¬3æ¬¡)
å†æ¬¡å¼‚å¸¸é€€å‡º â†’ è¶…è¿‡é™åˆ¶ï¼Œåœæ­¢é‡å¯
```

---

## 4. ğŸ”— æœåŠ¡ä¾èµ–ä¸é¡ºåº


### 4.1 ä¾èµ–å…³ç³»ç±»å‹


Linuxç³»ç»Ÿä¸­ï¼ŒæœåŠ¡ä¹‹é—´æœ‰å¤æ‚çš„ä¾èµ–å…³ç³»ï¼Œå°±åƒ**æ­ç§¯æœ¨**ä¸€æ ·:

**ğŸ”¸ å¼ºä¾èµ–å…³ç³» - Requires**:
```ini
[Unit]
Description=Webåº”ç”¨
Requires=mysql.service
After=mysql.service
```
> å«ä¹‰: Webåº”ç”¨**å¿…é¡»**æœ‰MySQLæ‰èƒ½è¿è¡Œï¼ŒMySQLåœæ­¢äº†Webåº”ç”¨ä¹Ÿä¼šåœæ­¢

**ğŸ”¸ å¼±ä¾èµ–å…³ç³» - Wants**:
```ini
[Unit] 
Description=Webåº”ç”¨
Wants=redis.service
After=redis.service
```
> å«ä¹‰: Webåº”ç”¨**å¸Œæœ›**æœ‰Redisï¼Œä½†Rediså¯åŠ¨å¤±è´¥ä¸å½±å“Webåº”ç”¨è¿è¡Œ

### 4.2 å¯åŠ¨é¡ºåºæ§åˆ¶


**After/Before**åªæ§åˆ¶**å¯åŠ¨é¡ºåº**ï¼Œä¸æ§åˆ¶ä¾èµ–å…³ç³»:

```ini
# ç½‘ç»œæœåŠ¡é…ç½®
[Unit]
Description=ç½‘ç»œç›¸å…³æœåŠ¡
After=network.target network-online.target
Before=httpd.service
```

**å¯åŠ¨æµç¨‹**:
```
ç½‘ç»œæœåŠ¡å¯åŠ¨å®Œæˆ â†’ å½“å‰æœåŠ¡å¯åŠ¨ â†’ WebæœåŠ¡å™¨å¯åŠ¨
```

> âš ï¸ **é‡è¦åŒºåˆ«**  
> - **After/Before**: åªç®¡å¯åŠ¨å…ˆåé¡ºåº
> - **Requires/Wants**: ç®¡ç†ä¾èµ–å…³ç³»å’Œè”åŠ¨åœæ­¢
> - ä¸¤è€…ç»å¸¸éœ€è¦**ä¸€èµ·ä½¿ç”¨**

### 4.3 ç³»ç»Ÿç›®æ ‡ - Target


**WantedBy**æŒ‡å®šæœåŠ¡å±äºå“ªä¸ª**ç³»ç»Ÿç›®æ ‡**:

| ç³»ç»Ÿç›®æ ‡ | **å«ä¹‰** | **ç›¸å½“äºæ—§ç³»ç»Ÿ** |
|---------|---------|----------------|
| `multi-user.target` | **å¤šç”¨æˆ·å‘½ä»¤è¡Œæ¨¡å¼** | `è¿è¡Œçº§åˆ«3` |
| `graphical.target` | **å›¾å½¢ç•Œé¢æ¨¡å¼** | `è¿è¡Œçº§åˆ«5` |
| `basic.target` | **åŸºæœ¬ç³»ç»Ÿ** | `è¿è¡Œçº§åˆ«1` |

```ini
[Install]
WantedBy=multi-user.target
```
> å«ä¹‰: ç³»ç»Ÿå¯åŠ¨åˆ°å¤šç”¨æˆ·æ¨¡å¼æ—¶ï¼Œè‡ªåŠ¨å¯åŠ¨è¿™ä¸ªæœåŠ¡

---

## 5. ğŸ› ï¸ æ‰§è¡Œç¯å¢ƒé…ç½®


### 5.1 æ‰§è¡Œå‘½ä»¤é…ç½®


**ExecStart** - å¯åŠ¨å‘½ä»¤:
```ini
[Service]
# ç®€å•å‘½ä»¤
ExecStart=/usr/bin/myapp

# å¸¦å‚æ•°çš„å‘½ä»¤
ExecStart=/usr/bin/myapp --config /etc/myapp.conf

# å¤šè¡Œå‘½ä»¤ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰
ExecStartPre=/usr/bin/prepare-env
ExecStart=/usr/bin/myapp  
ExecStartPost=/usr/bin/cleanup-temp
```

**ExecStop** - åœæ­¢å‘½ä»¤:
```ini
[Service]
ExecStart=/usr/bin/myapp
ExecStop=/bin/kill -TERM $MAINPID
ExecStopPost=/usr/bin/cleanup-files
```

> ğŸ’¡ **$MAINPIDå˜é‡**  
> systemdè‡ªåŠ¨è®¾ç½®ï¼Œè¡¨ç¤ºä¸»è¿›ç¨‹çš„PID

### 5.2 è¿è¡Œç”¨æˆ·ä¸æƒé™


**User/Group** - æŒ‡å®šè¿è¡Œç”¨æˆ·:
```ini
[Service]
Type=simple
ExecStart=/usr/bin/webapp
User=webapp
Group=webapp
```

**å®‰å…¨è€ƒè™‘**:
- ğŸ”¸ **æ™®é€šåº”ç”¨**ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·è¿è¡Œ
- ğŸ”¸ **ç³»ç»ŸæœåŠ¡**å¯èƒ½éœ€è¦rootæƒé™
- ğŸ”¸ **WebæœåŠ¡**é€šå¸¸ä½¿ç”¨www-dataç”¨æˆ·

### 5.3 å·¥ä½œç¯å¢ƒé…ç½®


**WorkingDirectory** - å·¥ä½œç›®å½•:
```ini
[Service]
Type=simple
ExecStart=/usr/bin/python3 app.py
WorkingDirectory=/opt/myapp
User=myapp
```

**Environment** - ç¯å¢ƒå˜é‡:
```ini
[Service]
ExecStart=/usr/bin/myapp
Environment=PYTHON_PATH=/opt/myapp
Environment=CONFIG_FILE=/etc/myapp.conf
EnvironmentFile=/etc/default/myapp
```

---

## 6. ğŸš€ å®æˆ˜é…ç½®ç¤ºä¾‹


### 6.1 Webåº”ç”¨æœåŠ¡é…ç½®


åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨æœåŠ¡é…ç½®:

```ini
# /etc/systemd/system/webapp.service
[Unit]
Description=æˆ‘çš„Webåº”ç”¨
Documentation=https://example.com/docs
After=network-online.target mysql.service
Wants=mysql.service

[Service]
Type=simple
User=webapp
Group=webapp
WorkingDirectory=/opt/webapp
ExecStart=/usr/bin/python3 app.py
ExecReload=/bin/kill -HUP $MAINPID
Restart=on-failure
RestartSec=5s

# ç¯å¢ƒé…ç½®
Environment=FLASK_ENV=production
EnvironmentFile=-/etc/default/webapp

# å®‰å…¨é…ç½®
NoNewPrivileges=true
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

**æ¿€æ´»æœåŠ¡**:
```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl enable webapp.service
sudo systemctl start webapp.service

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status webapp.service
```

### 6.2 å¤‡ä»½ä»»åŠ¡é…ç½®


ä¸€æ¬¡æ€§å¤‡ä»½ä»»åŠ¡çš„é…ç½®:

```ini
# /etc/systemd/system/daily-backup.service  
[Unit]
Description=æ¯æ—¥æ•°æ®å¤‡ä»½
After=multi-user.target

[Service]
Type=oneshot
User=backup
ExecStart=/usr/local/bin/backup-script.sh
RemainAfterExit=yes

# å¯¹åº”çš„å®šæ—¶å™¨é…ç½®
# /etc/systemd/system/daily-backup.timer
[Unit]
Description=æ¯æ—¥å¤‡ä»½å®šæ—¶å™¨
Requires=daily-backup.service

[Timer]
OnCalendar=daily
Persistent=true

[Install]
WantedBy=timers.target
```

**ç®¡ç†å®šæ—¶ä»»åŠ¡**:
```bash
# å¯ç”¨å®šæ—¶å™¨
sudo systemctl enable daily-backup.timer
sudo systemctl start daily-backup.timer

# æŸ¥çœ‹å®šæ—¶å™¨çŠ¶æ€
systemctl list-timers daily-backup.timer
```

### 6.3 ä¼ ç»Ÿå®ˆæŠ¤è¿›ç¨‹é…ç½®


é…ç½®Nginxè¿™æ ·çš„ä¼ ç»Ÿå®ˆæŠ¤è¿›ç¨‹:

```ini
# /etc/systemd/system/nginx.service
[Unit]
Description=é«˜æ€§èƒ½WebæœåŠ¡å™¨
Documentation=http://nginx.org/en/docs/
After=network-online.target remote-fs.target nss-lookup.target
Wants=network-online.target

[Service]
Type=forking
PIDFile=/var/run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t
ExecStart=/usr/sbin/nginx
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s TERM $MAINPID
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å¯åŠ¨ç±»å‹é€‰æ‹©**:
- **simple**: æœ€å¸¸ç”¨ï¼Œç¨‹åºç›´æ¥è¿è¡Œ
- **forking**: ä¼ ç»Ÿå®ˆæŠ¤è¿›ç¨‹ï¼Œä¼šåˆ›å»ºå­è¿›ç¨‹
- **oneshot**: ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå°±é€€å‡º
- **notify**: ç°ä»£ç¨‹åºï¼Œä¼šä¸»åŠ¨é€šçŸ¥systemd

**ğŸ”¸ é‡å¯ç­–ç•¥é…ç½®**:
- **always**: æ€»æ˜¯é‡å¯ï¼Œé€‚åˆå…³é”®æœåŠ¡
- **on-failure**: å¼‚å¸¸æ—¶é‡å¯ï¼Œé€‚åˆæ™®é€šåº”ç”¨
- **RestartSec**: é‡å¯ç­‰å¾…æ—¶é—´
- **StartLimitBurst**: é‡å¯æ¬¡æ•°é™åˆ¶

**ğŸ”¸ ä¾èµ–å…³ç³»ç®¡ç†**:
- **Requires**: å¼ºä¾èµ–ï¼Œå¿…é¡»çš„æœåŠ¡
- **Wants**: å¼±ä¾èµ–ï¼Œå¯é€‰çš„æœåŠ¡
- **After/Before**: å¯åŠ¨é¡ºåºæ§åˆ¶
- **WantedBy**: å½’å±çš„ç³»ç»Ÿç›®æ ‡

### 7.2 å®ç”¨é…ç½®æŠ€å·§


**ğŸ”¹ æœåŠ¡é…ç½®æœ€ä½³å®è·µ**:
```ini
# åŸºæœ¬ç»“æ„æ¨¡æ¿
[Unit]
Description=æœåŠ¡æè¿°
After=network-online.target
Wants=ç›¸å…³æœåŠ¡

[Service]  
Type=simple
User=ä¸“ç”¨ç”¨æˆ·
WorkingDirectory=å·¥ä½œç›®å½•
ExecStart=å¯åŠ¨å‘½ä»¤
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
```

**ğŸ”¹ å¸¸ç”¨systemctlå‘½ä»¤**:
```bash
# é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload

# å¯ç”¨å¼€æœºè‡ªå¯
sudo systemctl enable æœåŠ¡å

# å¯åŠ¨æœåŠ¡
sudo systemctl start æœåŠ¡å

# æŸ¥çœ‹çŠ¶æ€
systemctl status æœåŠ¡å

# æŸ¥çœ‹æ—¥å¿—
journalctl -u æœåŠ¡å
```

### 7.3 æ•…éšœæ’æŸ¥è¦ç‚¹


**ğŸ”¸ æœåŠ¡å¯åŠ¨å¤±è´¥**:
1. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•: `systemd-analyze verify æœåŠ¡æ–‡ä»¶`
2. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—: `journalctl -u æœåŠ¡å -f`
3. æ£€æŸ¥æ–‡ä»¶æƒé™å’Œè·¯å¾„æ˜¯å¦æ­£ç¡®

**ğŸ”¸ æœåŠ¡é¢‘ç¹é‡å¯**:
1. æŸ¥çœ‹é‡å¯åŸå› : `journalctl -u æœåŠ¡å`
2. æ£€æŸ¥StartLimitBursté…ç½®
3. è°ƒæ•´RestartSecç­‰å¾…æ—¶é—´

**ğŸ”¸ ä¾èµ–å…³ç³»é—®é¢˜**:
1. æ£€æŸ¥ä¾èµ–æœåŠ¡çŠ¶æ€: `systemctl status ä¾èµ–æœåŠ¡`
2. æŸ¥çœ‹å¯åŠ¨é¡ºåº: `systemctl list-dependencies æœåŠ¡å`
3. éªŒè¯After/Beforeé…ç½®

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**:
- systemdç®¡ç†æœåŠ¡éœ€è¦çŸ¥é“ç¨‹åºçš„è¿è¡Œç‰¹ç‚¹
- Typeç±»å‹è¦åŒ¹é…ç¨‹åºçš„å®é™…è¡Œä¸º
- ä¾èµ–å…³ç³»å’Œå¯åŠ¨é¡ºåºè¦åˆ†åˆ«é…ç½®  
- é‡å¯ç­–ç•¥è¦è€ƒè™‘æœåŠ¡çš„é‡è¦æ€§
- å®‰å…¨é…ç½®ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·è¿è¡ŒæœåŠ¡