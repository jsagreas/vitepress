---
title: 5ã€æœåŠ¡é…ç½®æ–‡ä»¶æ“ä½œ
---
## ğŸ“š ç›®å½•

1. [systemctl cat - æŸ¥çœ‹æœåŠ¡é…ç½®](#1-systemctl-cat-æŸ¥çœ‹æœåŠ¡é…ç½®)
2. [systemctl edit - åˆ›å»ºoverrideé…ç½®](#2-systemctl-edit-åˆ›å»ºoverrideé…ç½®)
3. [systemctl edit --full - å®Œæ•´ç¼–è¾‘](#3-systemctl-edit-full-å®Œæ•´ç¼–è¾‘)
4. [æœåŠ¡é…ç½®æ–‡ä»¶ç›®å½•ç»“æ„](#4-æœåŠ¡é…ç½®æ–‡ä»¶ç›®å½•ç»“æ„)
5. [systemd-analyze verify - é…ç½®éªŒè¯](#5-systemd-analyze-verify-é…ç½®éªŒè¯)
6. [systemctl show - æ˜¾ç¤ºæœåŠ¡å±æ€§](#6-systemctl-show-æ˜¾ç¤ºæœåŠ¡å±æ€§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” systemctl cat - æŸ¥çœ‹æœåŠ¡é…ç½®


### 1.1 åŸºæœ¬æ¦‚å¿µ

`systemctl cat` å‘½ä»¤ç”¨æ¥**æŸ¥çœ‹å®Œæ•´çš„æœåŠ¡é…ç½®æ–‡ä»¶å†…å®¹**ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰ç›¸å…³çš„é…ç½®ç‰‡æ®µåˆå¹¶æ˜¾ç¤ºï¼Œè®©ä½ çœ‹åˆ°ç³»ç»Ÿå®é™…ä½¿ç”¨çš„å®Œæ•´é…ç½®ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå‘½ä»¤ï¼Ÿ**
æƒ³è±¡ä½ æœ‰ä¸€æœ¬ä¹¦ï¼Œä½†è¿™æœ¬ä¹¦çš„å†…å®¹åˆ†æ•£åœ¨å¥½å‡ ä¸ªæ–‡ä»¶é‡Œ - æœ‰åŸå§‹ç‰ˆæœ¬ï¼Œè¿˜æœ‰ä¿®æ”¹ç‰ˆæœ¬ã€‚`systemctl cat` å°±åƒæŠŠæ‰€æœ‰é¡µé¢æŒ‰é¡ºåºåˆå¹¶ï¼Œè®©ä½ çœ‹åˆ°å®Œæ•´çš„"æœ€ç»ˆç‰ˆæœ¬"ã€‚

### 1.2 åŸºæœ¬ç”¨æ³•


```bash
# æŸ¥çœ‹nginxæœåŠ¡çš„å®Œæ•´é…ç½®
systemctl cat nginx

# æŸ¥çœ‹å¤šä¸ªæœåŠ¡é…ç½®
systemctl cat nginx apache2

# æŸ¥çœ‹ç³»ç»ŸæœåŠ¡é…ç½®
systemctl cat sshd
```

**è¾“å‡ºç¤ºä¾‹è§£è¯»ï¼š**
```
# /lib/systemd/system/nginx.service
[Unit]
Description=A high performance web server
After=network.target

[Service]
Type=forking
ExecStart=/usr/sbin/nginx
ExecReload=/bin/kill -s HUP $MAINPID

[Install]
WantedBy=multi-user.target

# /etc/systemd/system/nginx.service.d/override.conf
[Service]
LimitNOFILE=65536
```

**é…ç½®æ¥æºè¯´æ˜ï¼š**
- ç¬¬ä¸€éƒ¨åˆ†ï¼š`/lib/systemd/system/nginx.service` - ç³»ç»Ÿé»˜è®¤é…ç½®
- ç¬¬äºŒéƒ¨åˆ†ï¼š`/etc/systemd/system/nginx.service.d/override.conf` - è‡ªå®šä¹‰è¦†ç›–é…ç½®

### 1.3 å®ç”¨æŠ€å·§


**ğŸ”¸ å¿«é€Ÿå®šä½é—®é¢˜é…ç½®**
```bash
# æŸ¥çœ‹é…ç½®å¹¶è¿‡æ»¤å…³é”®ä¿¡æ¯
systemctl cat nginx | grep -E "ExecStart|ExecReload|User"

# æŸ¥çœ‹é…ç½®æ–‡ä»¶æ¥æº
systemctl cat nginx | grep "^# /"
```

**ğŸ’¡ ç†è§£é…ç½®ä¼˜å…ˆçº§**
systemctl catæ˜¾ç¤ºçš„å†…å®¹æ˜¯**ä»ä¸Šåˆ°ä¸‹**æŒ‰ä¼˜å…ˆçº§æ’åˆ—çš„ï¼š
- ç³»ç»Ÿé»˜è®¤é…ç½®åœ¨å‰
- ç”¨æˆ·è‡ªå®šä¹‰é…ç½®åœ¨åï¼ˆä¼šè¦†ç›–å‰é¢çš„ç›¸åŒè®¾ç½®ï¼‰

---

## 2. âœï¸ systemctl edit - åˆ›å»ºoverrideé…ç½®


### 2.1 ä»€ä¹ˆæ˜¯overrideé…ç½®

**é€šä¿—ç†è§£ï¼š** overrideé…ç½®å°±åƒæ˜¯ç»™åŸæœ¬çš„æœåŠ¡"æ‰“è¡¥ä¸"ã€‚ä½ ä¸éœ€è¦ä¿®æ”¹åŸå§‹é…ç½®æ–‡ä»¶ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ª"è¡¥ä¸æ–‡ä»¶"ï¼Œå‘Šè¯‰ç³»ç»Ÿå“ªäº›åœ°æ–¹éœ€è¦æ”¹å˜ã€‚

**ä¸ºä»€ä¹ˆç”¨overrideè€Œä¸ç›´æ¥ä¿®æ”¹ï¼Ÿ**
```
åŸå§‹é…ç½®æ–‡ä»¶ â†’ ç³»ç»Ÿæ›´æ–°æ—¶ä¼šè¢«è¦†ç›– âŒ
overrideé…ç½® â†’ ç³»ç»Ÿæ›´æ–°æ—¶ä¼šä¿ç•™ âœ…
```

### 2.2 åŸºæœ¬æ“ä½œ


```bash
# ä¸ºnginxæœåŠ¡åˆ›å»ºoverrideé…ç½®
systemctl edit nginx
```

**æ“ä½œæµç¨‹ï¼š**
1. å‘½ä»¤æ‰§è¡Œåä¼šæ‰“å¼€æ–‡æœ¬ç¼–è¾‘å™¨
2. åœ¨ç¼–è¾‘å™¨ä¸­å†™å…¥è¦ä¿®æ”¹çš„é…ç½®
3. ä¿å­˜é€€å‡ºï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºoverrideæ–‡ä»¶

**ç¼–è¾‘å™¨ç•Œé¢ç¤ºä¾‹ï¼š**
```ini
## åœ¨ä¸‹é¢æ·»åŠ ä½ è¦ä¿®æ”¹çš„é…ç½® ###

[Service]
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
LimitNOFILE=65536
# è®¾ç½®é‡å¯ç­–ç•¥
Restart=always
RestartSec=10

## ä¸Šé¢çš„é…ç½®ä¼šè¦†ç›–åŸå§‹è®¾ç½® ###

```

### 2.3 å¸¸è§é…ç½®ä¿®æ”¹åœºæ™¯


**ğŸ”¸ ä¿®æ”¹æœåŠ¡å¯åŠ¨å‚æ•°**
```ini
[Service]
# åŸå§‹: ExecStart=/usr/sbin/nginx
# ä¿®æ”¹ä¸º: ExecStart=/usr/sbin/nginx -c /etc/nginx/custom.conf
ExecStart=
ExecStart=/usr/sbin/nginx -c /etc/nginx/custom.conf
```

> **âš ï¸ é‡è¦æé†’ï¼š** å¦‚æœè¦ä¿®æ”¹ExecStartï¼Œå¿…é¡»å…ˆç”¨ç©ºå€¼æ¸…ç©ºï¼ˆ`ExecStart=`ï¼‰ï¼Œç„¶åå†è®¾ç½®æ–°å€¼ã€‚

**ğŸ”¸ ä¿®æ”¹èµ„æºé™åˆ¶**
```ini
[Service]
LimitNOFILE=65536    # æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
LimitNPROC=32768     # è¿›ç¨‹æ•°é™åˆ¶
LimitCORE=0          # æ ¸å¿ƒè½¬å‚¨å¤§å°
```

**ğŸ”¸ ä¿®æ”¹é‡å¯ç­–ç•¥**
```ini
[Service]
Restart=always       # æ€»æ˜¯é‡å¯
RestartSec=10        # é‡å¯é—´éš”10ç§’
StartLimitBurst=3    # å¯åŠ¨å¤±è´¥3æ¬¡ååœæ­¢å°è¯•
```

### 2.4 overrideé…ç½®å­˜å‚¨ä½ç½®


```
é…ç½®æ–‡ä»¶è·¯å¾„ç»“æ„ï¼š
/etc/systemd/system/
â”œâ”€â”€ nginx.service.d/
â”‚   â””â”€â”€ override.conf     â† systemctl editåˆ›å»ºçš„æ–‡ä»¶
â”œâ”€â”€ apache2.service.d/
â”‚   â””â”€â”€ override.conf
â””â”€â”€ ...

è¯´æ˜ï¼šæ¯ä¸ªæœåŠ¡çš„overrideé…ç½®å­˜å‚¨åœ¨ç‹¬ç«‹çš„.dç›®å½•ä¸­
```

---

## 3. ğŸ“ systemctl edit --full - å®Œæ•´ç¼–è¾‘


### 2.1 å®Œæ•´ç¼–è¾‘ vs overrideç¼–è¾‘


**å¯¹æ¯”ç†è§£ï¼š**
- `systemctl edit` â†’ åªä¿®æ”¹éƒ¨åˆ†è®¾ç½®ï¼ˆæ¨èï¼‰
- `systemctl edit --full` â†’ å®Œå…¨é‡å†™æ•´ä¸ªé…ç½®æ–‡ä»¶ï¼ˆæ…ç”¨ï¼‰

```
systemctl edit nginx
# åˆ›å»º /etc/systemd/system/nginx.service.d/override.conf
# åªè¦†ç›–ä½ æŒ‡å®šçš„é…ç½®é¡¹

systemctl edit --full nginx  
# åˆ›å»º /etc/systemd/system/nginx.service
# å®Œå…¨æ›¿æ¢åŸå§‹é…ç½®æ–‡ä»¶
```

### 3.2 ä½¿ç”¨åœºæ™¯


**ğŸ”¸ é€‚åˆä½¿ç”¨ --full çš„æƒ…å†µï¼š**
- éœ€è¦å¤§å¹…ä¿®æ”¹æœåŠ¡é…ç½®
- åŸå§‹é…ç½®æ–‡ä»¶è¿‡äºå¤æ‚ï¼Œoverrideæ–¹å¼ä¸å¤Ÿæ¸…æ™°
- åˆ›å»ºå…¨æ–°çš„è‡ªå®šä¹‰æœåŠ¡

**ğŸ”¸ ä¸å»ºè®®ä½¿ç”¨ --full çš„æƒ…å†µï¼š**
- åªéœ€è¦ä¿®æ”¹å°‘æ•°å‡ ä¸ªå‚æ•°
- å¸Œæœ›ä¿æŒä¸ç³»ç»Ÿæ›´æ–°çš„å…¼å®¹æ€§

### 3.3 æ“ä½œç¤ºä¾‹


```bash
# å®Œæ•´ç¼–è¾‘nginxé…ç½®
systemctl edit --full nginx
```

**ç¼–è¾‘ç•Œé¢æ˜¾ç¤ºå®Œæ•´çš„æœåŠ¡æ–‡ä»¶ï¼š**
```ini
[Unit]
Description=A high performance web server and a reverse proxy server
Documentation=man:nginx(8)
After=network.target nss-lookup.target

[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t -q -g 'daemon on; master_process on;'
ExecStart=/usr/sbin/nginx -g 'daemon on; master_process on;'
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s QUIT $MAINPID
TimeoutStopSec=5
KillMode=mixed
# ä½ å¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹ä»»ä½•é…ç½®

[Install]  
WantedBy=multi-user.target
```

**âš ï¸ é‡è¦æé†’ï¼š** ä½¿ç”¨ `--full` é€‰é¡¹åï¼Œç”Ÿæˆçš„æ–‡ä»¶ä¼šå®Œå…¨æ›¿æ¢ç³»ç»Ÿé»˜è®¤é…ç½®ï¼Œç³»ç»Ÿæ›´æ–°æ—¶ä¸ä¼šè‡ªåŠ¨åˆå¹¶æ–°çš„é»˜è®¤é…ç½®ã€‚

---

## 4. ğŸ“ æœåŠ¡é…ç½®æ–‡ä»¶ç›®å½•ç»“æ„


### 4.1 ç›®å½•å±‚æ¬¡ç†è§£


**é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š**
```
/etc/systemd/system/æœåŠ¡å.service          â† æœ€é«˜ä¼˜å…ˆçº§
/etc/systemd/system/æœåŠ¡å.service.d/        â† ç”¨æˆ·overrideé…ç½®
/lib/systemd/system/æœåŠ¡å.service           â† ç³»ç»Ÿé»˜è®¤é…ç½®
/usr/lib/systemd/system/æœåŠ¡å.service       â† è½¯ä»¶åŒ…é»˜è®¤é…ç½®
```

**é€šä¿—æ¯”å–»ï¼š**
æƒ³è±¡è¿™äº›ç›®å½•åƒæ˜¯ä¸€æ‘çº¸ï¼š
- æœ€ä¸Šé¢çš„çº¸ï¼ˆ/etc/systemd/system/ï¼‰æœ€é‡è¦ï¼Œä¼šé®ä½ä¸‹é¢çš„å†…å®¹
- ä¸­é—´çš„çº¸ï¼ˆ/etc/systemd/system/æœåŠ¡å.service.d/ï¼‰æ˜¯è¡¥ä¸ï¼Œåªè¦†ç›–éƒ¨åˆ†å†…å®¹
- æœ€ä¸‹é¢çš„çº¸ï¼ˆ/lib/systemd/system/ï¼‰æ˜¯åŸå§‹æ¨¡æ¿

### 4.2 å„ç›®å½•è¯¦ç»†è¯´æ˜


**ğŸ”¸ /lib/systemd/system/ - ç³»ç»Ÿé»˜è®¤ç›®å½•**
```bash
# æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤æœåŠ¡æ–‡ä»¶
ls /lib/systemd/system/nginx.service
ls /lib/systemd/system/ssh*.service

# ç‰¹ç‚¹ï¼š
# - è½¯ä»¶åŒ…å®‰è£…æ—¶åˆ›å»º
# - ç³»ç»Ÿæ›´æ–°æ—¶ä¼šè¢«è¦†ç›–
# - ä¸å»ºè®®ç›´æ¥ä¿®æ”¹
```

**ğŸ”¸ /etc/systemd/system/ - ç”¨æˆ·é…ç½®ç›®å½•**
```bash
# æŸ¥çœ‹ç”¨æˆ·è‡ªå®šä¹‰é…ç½®
ls /etc/systemd/system/nginx.service
ls /etc/systemd/system/nginx.service.d/

# ç‰¹ç‚¹ï¼š
# - ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†
# - ç³»ç»Ÿæ›´æ–°æ—¶ä¿æŒä¸å˜  
# - ä¼˜å…ˆçº§æœ€é«˜
```

### 4.3 .service.d/ ç›®å½•ç»“æ„è¯¦è§£


**ç›®å½•å‘½åè§„åˆ™ï¼š**
```
æœåŠ¡é…ç½®ç›®å½•ç»“æ„ï¼š
/etc/systemd/system/
â”œâ”€â”€ nginx.service.d/
â”‚   â”œâ”€â”€ override.conf          â† systemctl edit åˆ›å»º
â”‚   â”œâ”€â”€ custom-limits.conf     â† æ‰‹åŠ¨åˆ›å»ºçš„é…ç½®ç‰‡æ®µ
â”‚   â””â”€â”€ security.conf          â† å¦ä¸€ä¸ªé…ç½®ç‰‡æ®µ
â”œâ”€â”€ apache2.service.d/
â”‚   â””â”€â”€ override.conf
â””â”€â”€ ...

é‡è¦è§„åˆ™ï¼š
- ç›®å½•åå¿…é¡»æ˜¯ "æœåŠ¡å.service.d"
- é…ç½®æ–‡ä»¶å¿…é¡»ä»¥ ".conf" ç»“å°¾
- å¯ä»¥æœ‰å¤šä¸ª.confæ–‡ä»¶ï¼ŒæŒ‰æ–‡ä»¶åå­—æ¯é¡ºåºåŠ è½½
```

**æ‰‹åŠ¨åˆ›å»ºé…ç½®ç‰‡æ®µç¤ºä¾‹ï¼š**
```bash
# åˆ›å»ºç›®å½•
sudo mkdir -p /etc/systemd/system/nginx.service.d

# åˆ›å»ºå®‰å…¨é…ç½®ç‰‡æ®µ
sudo tee /etc/systemd/system/nginx.service.d/security.conf << 'EOF'
[Service]
# å®‰å…¨é™åˆ¶
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
EOF

# åˆ›å»ºèµ„æºé™åˆ¶é…ç½®ç‰‡æ®µ
sudo tee /etc/systemd/system/nginx.service.d/limits.conf << 'EOF'
[Service]
# èµ„æºé™åˆ¶
LimitNOFILE=65536
LimitNPROC=32768
EOF
```

### 4.4 é…ç½®æ–‡ä»¶æŸ¥æ‰¾é¡ºåº


**systemd æŸ¥æ‰¾é…ç½®çš„é¡ºåºï¼š**
```
æŸ¥æ‰¾æµç¨‹ï¼š
1. /etc/systemd/system/nginx.service        â† å¦‚æœå­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨ï¼Œå¿½ç•¥å…¶ä»–
2. /etc/systemd/system/nginx.service.d/     â† åŠ è½½æ‰€æœ‰.confæ–‡ä»¶ä½œä¸ºè¦†ç›–
3. /lib/systemd/system/nginx.service        â† åŸºç¡€é…ç½®æ–‡ä»¶
4. åˆå¹¶æ‰€æœ‰é…ç½®ï¼Œå½¢æˆæœ€ç»ˆçš„æœåŠ¡é…ç½®

å®é™…ç¤ºä¾‹ï¼š
åŸºç¡€é…ç½®ï¼š/lib/systemd/system/nginx.service (LimitNOFILE=1024)
è¦†ç›–é…ç½®ï¼š/etc/systemd/system/nginx.service.d/override.conf (LimitNOFILE=65536)
æœ€ç»ˆç»“æœï¼šLimitNOFILE=65536 (è¦†ç›–ç”Ÿæ•ˆ)
```

---

## 5. âœ… systemd-analyze verify - é…ç½®éªŒè¯


### 5.1 é…ç½®éªŒè¯çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆè¦éªŒè¯é…ç½®ï¼Ÿ**
ä¿®æ”¹æœåŠ¡é…ç½®å°±åƒä¿®æ”¹æ±½è½¦å¼•æ“ - ä¸€ä¸ªå°é”™è¯¯å¯èƒ½å¯¼è‡´æ•´ä¸ªæœåŠ¡æ— æ³•å¯åŠ¨ã€‚é…ç½®éªŒè¯å°±æ˜¯åœ¨"ç‚¹ç«"ä¹‹å‰æ£€æŸ¥æ‰€æœ‰éƒ¨ä»¶æ˜¯å¦æ­£ç¡®å®‰è£…ã€‚

### 5.2 éªŒè¯å‘½ä»¤ä½¿ç”¨


```bash
# éªŒè¯ç‰¹å®šæœåŠ¡é…ç½®
systemd-analyze verify nginx.service

# éªŒè¯å¤šä¸ªæœåŠ¡é…ç½®  
systemd-analyze verify nginx.service apache2.service

# éªŒè¯æ‰€æœ‰æœåŠ¡é…ç½®ï¼ˆè€—æ—¶è¾ƒé•¿ï¼‰
systemd-analyze verify
```

### 5.3 å¸¸è§éªŒè¯é”™è¯¯å’Œè§£å†³


**ğŸ”¸ é…ç½®è¯­æ³•é”™è¯¯**
```bash
# éªŒè¯ç»“æœç¤ºä¾‹
systemd-analyze verify nginx.service
# nginx.service:8: Missing '=' in assignment
# nginx.service:12: Unknown key name 'ExecStrat' in section '[Service]'

å¸¸è§é”™è¯¯ç±»å‹ï¼š
- ç¼ºå°‘ç­‰å· (Missing '=')
- é…ç½®é¡¹åç§°é”™è¯¯ (Unknown key name)
- æ®µåé”™è¯¯ (Unknown section)
- å€¼æ ¼å¼é”™è¯¯ (Invalid value)
```

**ğŸ”¸ ä¾èµ–å…³ç³»é”™è¯¯**
```bash
# é”™è¯¯ç¤ºä¾‹ï¼šå¾ªç¯ä¾èµ–
nginx.service: Job nginx.service/start deleted to break ordering cycle starting with nginx.service

è§£å†³æ–¹æ³•ï¼š
æ£€æŸ¥ Afterã€Beforeã€Wantsã€Requires ç­‰ä¾èµ–å…³ç³»é…ç½®
ç¡®ä¿æ²¡æœ‰å½¢æˆå¾ªç¯ä¾èµ–
```

### 5.4 éªŒè¯æœ€ä½³å®è·µ


**éªŒè¯å·¥ä½œæµç¨‹ï¼š**
```
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
   â†“
2. è¿è¡Œ systemd-analyze verify
   â†“  
3. ä¿®å¤å‘ç°çš„é”™è¯¯
   â†“
4. é‡æ–°éªŒè¯ç›´åˆ°æ— é”™è¯¯
   â†“
5. é‡æ–°åŠ è½½é…ç½® (systemctl daemon-reload)
   â†“
6. æµ‹è¯•æœåŠ¡å¯åŠ¨ (systemctl restart æœåŠ¡å)
```

**æ‰¹é‡éªŒè¯è„šæœ¬ç¤ºä¾‹ï¼š**
```bash
#!/bin/bash
# éªŒè¯æ‰€æœ‰è‡ªå®šä¹‰æœåŠ¡é…ç½®
for service in /etc/systemd/system/*.service; do
    if [ -f "$service" ]; then
        echo "éªŒè¯ $(basename "$service")..."
        systemd-analyze verify "$service" || echo "âŒ éªŒè¯å¤±è´¥"
    fi
done
```

---

## 6. ğŸ“Š systemctl show - æ˜¾ç¤ºæœåŠ¡å±æ€§


### 6.1 showå‘½ä»¤åŸºæœ¬ç”¨æ³•


**åŸºæœ¬æ¦‚å¿µï¼š** `systemctl show` å¯ä»¥æ˜¾ç¤ºæœåŠ¡çš„**æ‰€æœ‰è¿è¡Œæ—¶å±æ€§**ï¼ŒåŒ…æ‹¬é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®ã€ç³»ç»Ÿåˆ†é…çš„èµ„æºã€å½“å‰è¿è¡ŒçŠ¶æ€ç­‰ã€‚

```bash
# æ˜¾ç¤ºæœåŠ¡çš„æ‰€æœ‰å±æ€§ï¼ˆè¾“å‡ºå¾ˆé•¿ï¼‰
systemctl show nginx

# æ˜¾ç¤ºç‰¹å®šå±æ€§
systemctl show --property=MainPID,ActiveState,LoadState nginx

# æ˜¾ç¤ºå¤šä¸ªæœåŠ¡çš„ç›¸åŒå±æ€§
systemctl show --property=ActiveState nginx apache2 sshd
```

### 6.2 å¸¸ç”¨å±æ€§æŸ¥è¯¢


**ğŸ”¸ æœåŠ¡çŠ¶æ€å±æ€§**
```bash
# æŸ¥çœ‹æœåŠ¡åŸºæœ¬çŠ¶æ€
systemctl show --property=ActiveState,SubState,LoadState nginx
# ActiveState=active        # æœåŠ¡æ˜¯å¦æ¿€æ´»
# SubState=running         # è¯¦ç»†è¿è¡ŒçŠ¶æ€  
# LoadState=loaded         # é…ç½®æ˜¯å¦æˆåŠŸåŠ è½½

# æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯
systemctl show --property=MainPID,ExecStart,ExecMainCode nginx
# MainPID=1234             # ä¸»è¿›ç¨‹ID
# ExecStart={ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx }
# ExecMainCode=0           # ä¸»è¿›ç¨‹é€€å‡ºä»£ç 
```

**ğŸ”¸ èµ„æºä½¿ç”¨å±æ€§**
```bash
# æŸ¥çœ‹èµ„æºé™åˆ¶
systemctl show --property=LimitNOFILE,LimitNPROC,LimitMEMLOCK nginx
# LimitNOFILE=65536        # æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
# LimitNPROC=32768         # è¿›ç¨‹æ•°é™åˆ¶
# LimitMEMLOCK=65536       # å†…å­˜é”å®šé™åˆ¶

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
systemctl show --property=MemoryCurrent,MemoryLimit nginx  
# MemoryCurrent=52428800   # å½“å‰å†…å­˜ä½¿ç”¨ï¼ˆå­—èŠ‚ï¼‰
# MemoryLimit=infinity     # å†…å­˜é™åˆ¶
```

**ğŸ”¸ æ—¶é—´å’Œé‡å¯å±æ€§**  
```bash
# æŸ¥çœ‹å¯åŠ¨æ—¶é—´ä¿¡æ¯
systemctl show --property=ActiveEnterTimestamp,ExecMainStartTimestamp nginx
# ActiveEnterTimestamp=Mon 2025-01-21 10:30:15 CST
# ExecMainStartTimestamp=Mon 2025-01-21 10:30:14 CST

# æŸ¥çœ‹é‡å¯é…ç½®
systemctl show --property=Restart,RestartSec,StartLimitBurst nginx
# Restart=no               # é‡å¯ç­–ç•¥
# RestartSec=100ms         # é‡å¯é—´éš”
# StartLimitBurst=5        # å¯åŠ¨å¤±è´¥é™åˆ¶æ¬¡æ•°
```

### 6.3 å±æ€§æ˜¾ç¤ºæ ¼å¼åŒ–


**æ ¼å¼åŒ–è¾“å‡ºæŠ€å·§ï¼š**
```bash
# ä»¥è¡¨æ ¼å½¢å¼æ˜¾ç¤ºå¤šä¸ªæœåŠ¡çŠ¶æ€
systemctl show --property=Id,ActiveState,MainPID nginx apache2 sshd | \
  awk 'BEGIN{printf "%-15s %-10s %-8s\n", "Service", "State", "PID"; print "-----------------------------------"} 
       /^Id=/ {service=$0; gsub(/Id=/, "", service)} 
       /^ActiveState=/ {state=$0; gsub(/ActiveState=/, "", state)} 
       /^MainPID=/ {pid=$0; gsub(/MainPID=/, "", pid); printf "%-15s %-10s %-8s\n", service, state, pid}'
```

**ç»“åˆgrepè¿‡æ»¤æœ‰ç”¨ä¿¡æ¯ï¼š**
```bash
# æ˜¾ç¤ºæœåŠ¡é…ç½®æ–‡ä»¶è·¯å¾„
systemctl show nginx | grep -E "(FragmentPath|DropInPaths)"
# FragmentPath=/lib/systemd/system/nginx.service
# DropInPaths=/etc/systemd/system/nginx.service.d/override.conf

# æ˜¾ç¤ºæœåŠ¡ä¾èµ–å…³ç³»
systemctl show nginx | grep -E "(After|Before|Wants|Requires)"
```

### 6.4 å®ç”¨æŸ¥è¯¢ç¤ºä¾‹


**ğŸ”¸ æœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬**
```bash
#!/bin/bash
# æ£€æŸ¥å…³é”®æœåŠ¡çŠ¶æ€
services=("nginx" "apache2" "sshd" "mysql")

for service in "${services[@]}"; do
    status=$(systemctl show --property=ActiveState "$service" 2>/dev/null | cut -d= -f2)
    pid=$(systemctl show --property=MainPID "$service" 2>/dev/null | cut -d= -f2)
    
    if [ "$status" = "active" ]; then
        echo "âœ… $service: è¿è¡Œä¸­ (PID: $pid)"
    else
        echo "âŒ $service: $status"
    fi
done
```

**ğŸ”¸ èµ„æºä½¿ç”¨ç›‘æ§**
```bash
# ç›‘æ§æœåŠ¡èµ„æºä½¿ç”¨
echo "æœåŠ¡èµ„æºä½¿ç”¨æƒ…å†µï¼š"
systemctl show --property=Id,MemoryCurrent,LimitNOFILE nginx | \
  while IFS='=' read key value; do
    case $key in
      Id) echo -n "æœåŠ¡: $value - " ;;
      MemoryCurrent) echo -n "å†…å­˜: $(($value/1024/1024))MB - " ;;
      LimitNOFILE) echo "æ–‡ä»¶å¥æŸ„é™åˆ¶: $value" ;;
    esac
  done
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ systemctl catï¼šæŸ¥çœ‹å®Œæ•´æœåŠ¡é…ç½®ï¼Œæ˜¾ç¤ºæ‰€æœ‰é…ç½®ç‰‡æ®µåˆå¹¶ç»“æœ
ğŸ”¸ systemctl editï¼šåˆ›å»ºoverrideé…ç½®ï¼Œå®‰å…¨ä¿®æ”¹æœåŠ¡è®¾ç½®
ğŸ”¸ systemctl edit --fullï¼šå®Œæ•´ç¼–è¾‘ï¼Œæ…ç”¨ï¼Œä¼šæ›¿æ¢æ•´ä¸ªé…ç½®æ–‡ä»¶
ğŸ”¸ .service.d/ç›®å½•ï¼šå­˜å‚¨é…ç½®ç‰‡æ®µï¼Œå¯ä»¥æœ‰å¤šä¸ª.confæ–‡ä»¶
ğŸ”¸ systemd-analyze verifyï¼šé…ç½®éªŒè¯ï¼Œå‘ç°è¯­æ³•é”™è¯¯å’Œä¾èµ–é—®é¢˜
ğŸ”¸ systemctl showï¼šæ˜¾ç¤ºæœåŠ¡è¿è¡Œæ—¶å±æ€§ï¼Œæ”¯æŒæŒ‰å±æ€§æŸ¥è¯¢
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§è§„åˆ™**
```
ç†è§£åŸåˆ™ï¼š
/etc/systemd/system/ > /lib/systemd/system/
å®Œæ•´æ–‡ä»¶ > é…ç½®ç‰‡æ®µ
ç”¨æˆ·é…ç½® > ç³»ç»Ÿé»˜è®¤é…ç½®

å®é™…åº”ç”¨ï¼š
- ä¼˜å…ˆä½¿ç”¨ systemctl edit è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶
- override é…ç½®åœ¨ç³»ç»Ÿæ›´æ–°æ—¶ä¼šä¿ç•™
- ä½¿ç”¨ systemctl cat æŸ¥çœ‹æœ€ç»ˆç”Ÿæ•ˆçš„é…ç½®
```

**ğŸ”¹ é…ç½®ä¿®æ”¹çš„å®‰å…¨æµç¨‹**
```
æ¨èæµç¨‹ï¼š
1. systemctl edit æœåŠ¡å           (ç¼–è¾‘é…ç½®)
2. systemd-analyze verify æœåŠ¡å   (éªŒè¯é…ç½®) 
3. systemctl daemon-reload        (é‡è½½é…ç½®)
4. systemctl restart æœåŠ¡å       (é‡å¯æœåŠ¡)
5. systemctl status æœåŠ¡å        (æ£€æŸ¥çŠ¶æ€)
```

**ğŸ”¹ ä½•æ—¶ä½¿ç”¨ä¸åŒçš„ç¼–è¾‘æ–¹å¼**
```
systemctl editï¼š         â† æ¨èï¼Œåªä¿®æ”¹éœ€è¦æ”¹çš„éƒ¨åˆ†
systemctl edit --fullï¼š  â† æ…ç”¨ï¼Œéœ€è¦å¤§å¹…ä¿®æ”¹æ—¶ä½¿ç”¨
ç›´æ¥ç¼–è¾‘æ–‡ä»¶ï¼š            â† ä¸æ¨èï¼Œé™¤éç‰¹æ®Šæƒ…å†µ
```

### 7.3 å¸¸è§ä½¿ç”¨åœºæ™¯


**ğŸ”¸ è°ƒä¼˜æœåŠ¡æ€§èƒ½**
```bash
# å¢åŠ æ–‡ä»¶å¥æŸ„é™åˆ¶
systemctl edit nginx
# åœ¨ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼š
[Service]
LimitNOFILE=65536
```

**ğŸ”¸ ä¿®æ”¹å¯åŠ¨å‚æ•°**  
```bash
# ä¿®æ”¹æœåŠ¡å¯åŠ¨å‘½ä»¤
systemctl edit apache2
# åœ¨ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼š
[Service]
ExecStart=
ExecStart=/usr/sbin/apache2ctl -D FOREGROUND -f /etc/apache2/custom.conf
```

**ğŸ”¸ é…ç½®æœåŠ¡é‡å¯ç­–ç•¥**
```bash
# è®¾ç½®è‡ªåŠ¨é‡å¯
systemctl edit mysql
# åœ¨ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼š
[Service]
Restart=always
RestartSec=10
StartLimitBurst=3
```

**ğŸ”¸ æ’æŸ¥é…ç½®é—®é¢˜**
```bash
# å®Œæ•´çš„é—®é¢˜æ’æŸ¥æµç¨‹
systemctl cat nginx                    # æŸ¥çœ‹å½“å‰é…ç½®
systemd-analyze verify nginx.service   # éªŒè¯é…ç½®æ­£ç¡®æ€§
systemctl show --property=FragmentPath,DropInPaths nginx  # æŸ¥çœ‹é…ç½®æ–‡ä»¶ä½ç½®
systemctl status nginx                 # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```

### 7.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ“‹ é…ç½®ç®¡ç†æœ€ä½³å®è·µ**
- **âœ… DO**: ä½¿ç”¨ `systemctl edit` åˆ›å»ºoverrideé…ç½®
- **âœ… DO**: ä¿®æ”¹é…ç½®åå…ˆéªŒè¯å†é‡å¯
- **âœ… DO**: å¤‡ä»½é‡è¦çš„è‡ªå®šä¹‰é…ç½®
- **âŒ DON'T**: ç›´æ¥ä¿®æ”¹ `/lib/systemd/system/` ä¸­çš„æ–‡ä»¶
- **âŒ DON'T**: ä¸éªŒè¯é…ç½®å°±ç›´æ¥é‡å¯ç”Ÿäº§æœåŠ¡

**ğŸ”§ æ•…éšœæ’æŸ¥æ£€æŸ¥æ¸…å•**
- â˜ ä½¿ç”¨ `systemctl cat` æ£€æŸ¥é…ç½®åˆå¹¶ç»“æœ
- â˜ ä½¿ç”¨ `systemd-analyze verify` éªŒè¯é…ç½®è¯­æ³•  
- â˜ æ£€æŸ¥æœåŠ¡ä¾èµ–å…³ç³»æ˜¯å¦æ­£ç¡®
- â˜ ç¡®è®¤é…ç½®æ–‡ä»¶æƒé™æ­£ç¡®
- â˜ æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— `journalctl -u æœåŠ¡å`

**æ ¸å¿ƒè®°å¿†**ï¼š
- **æŸ¥çœ‹é…ç½®ç”¨ cat**ï¼Œæ˜¾ç¤ºåˆå¹¶åçš„å®Œæ•´é…ç½®
- **ä¿®æ”¹é…ç½®ç”¨ edit**ï¼Œå®‰å…¨çš„overrideæ–¹å¼  
- **éªŒè¯é…ç½®ç”¨ verify**ï¼Œé¿å…é…ç½®é”™è¯¯å¯¼è‡´æœåŠ¡æ— æ³•å¯åŠ¨
- **æŸ¥è¯¢å±æ€§ç”¨ show**ï¼Œäº†è§£æœåŠ¡è¿è¡Œæ—¶çŠ¶æ€
- **é…ç½®æ–‡ä»¶æœ‰ä¼˜å…ˆçº§**ï¼Œç”¨æˆ·é…ç½®è¦†ç›–ç³»ç»Ÿé»˜è®¤