---
title: 13、chkconfig传统服务管理
---
## 📚 目录

1. [chkconfig服务管理概述](#1-chkconfig服务管理概述)
2. [运行级别系统详解](#2-运行级别系统详解)
3. [chkconfig基本使用命令](#3-chkconfig基本使用命令)
4. [服务启动目录结构](#4-服务启动目录结构)
5. [Debian系统的update-rc.d](#5-debian系统的update-rc.d)
6. [现代systemctl对比转换](#6-现代systemctl对比转换)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🛠️ chkconfig服务管理概述


### 1.1 什么是chkconfig


**🔸 核心定义**
```
chkconfig：检查配置（check configuration）
作用：管理传统System V风格的系统服务
目标：控制服务在不同运行级别下的启动状态
适用：Red Hat、CentOS、SUSE等传统Linux发行版
```

**💡 为什么需要chkconfig**
在Linux系统中，有很多后台服务程序需要在系统启动时自动运行，比如网络服务、数据库服务等。chkconfig就是专门用来管理这些服务的工具，让系统管理员可以：
- 查看哪些服务会在开机时启动
- 设置服务开机自启动或禁用
- 针对不同的运行级别设置不同的服务状态

### 1.2 chkconfig的工作原理


**🔧 基本工作机制**
```
系统启动流程：
开机 → BIOS → 内核加载 → init进程 → 运行级别判断 → 启动对应服务

chkconfig的作用位置：
内核 → init → [chkconfig配置] → 服务启动/停止
```

**📋 管理对象**
- **系统服务**：如网络、防火墙、数据库等
- **启动脚本**：位于`/etc/init.d/`目录下的服务脚本
- **符号链接**：在各运行级别目录下创建启动/停止链接

---

## 2. 🎯 运行级别系统详解


### 2.1 Linux运行级别概念


**📊 运行级别定义表**

| 级别 | **名称** | **描述** | **典型用途** |
|------|---------|---------|-------------|
| **0** | `关机级别` | 系统关机状态 | 系统shutdown |
| **1** | `单用户模式` | 单用户维护模式，无网络 | 系统维护、密码恢复 |
| **2** | `多用户无网络` | 多用户模式但无网络服务 | 本地操作 |
| **3** | `多用户有网络` | 完整的多用户命令行模式 | **服务器标准模式** |
| **4** | `用户自定义` | 用户可自定义的级别 | 特殊需求配置 |
| **5** | `图形界面模式` | 多用户图形界面模式 | **桌面用户模式** |
| **6** | `重启级别` | 系统重启状态 | 系统reboot |

### 2.2 运行级别的实际意义


**🔸 常用运行级别解释**

**级别3（命令行模式）**：
```
特点：
- 完整的多用户环境
- 网络服务正常运行
- 没有图形界面
- 最适合服务器环境

典型启动服务：
✅ 网络服务(network)
✅ SSH服务(sshd)  
✅ 防火墙(iptables)
✅ 系统日志(rsyslog)
❌ 图形界面相关服务
```

**级别5（图形模式）**：
```
特点：
- 包含级别3的所有功能
- 额外启动图形界面服务
- 适合桌面用户

额外启动的服务：
✅ 显示管理器(gdm/kdm)
✅ 图形服务(X11)
✅ 桌面环境服务
```

### 2.3 查看和设置默认运行级别


**🔍 查看当前运行级别**
```bash
# 查看当前运行级别
runlevel
# 输出示例：N 3 (表示从无级别启动到级别3)

# 查看默认运行级别(传统方式)
cat /etc/inittab | grep initdefault
# 示例：id:3:initdefault:
```

**⚙️ 运行级别目录结构**
```
运行级别服务目录：
/etc/rc.d/rc0.d/  ← 关机时的服务
/etc/rc.d/rc1.d/  ← 单用户模式服务  
/etc/rc.d/rc2.d/  ← 多用户无网络模式服务
/etc/rc.d/rc3.d/  ← 多用户网络模式服务
/etc/rc.d/rc4.d/  ← 用户自定义模式服务
/etc/rc.d/rc5.d/  ← 图形界面模式服务
/etc/rc.d/rc6.d/  ← 重启时的服务
```

---

## 3. 📋 chkconfig基本使用命令


### 3.1 查看服务状态命令


**🔸 列出所有服务状态**
```bash
# 查看所有服务在各运行级别的状态
chkconfig --list

# 输出示例：
# httpd           0:关闭  1:关闭  2:关闭  3:启用  4:关闭  5:启用  6:关闭
# iptables        0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
# network         0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
```

**🔍 查看特定服务状态**
```bash
# 查看指定服务状态
chkconfig --list httpd
# 输出：httpd  0:关闭  1:关闭  2:关闭  3:启用  4:关闭  5:启用  6:关闭

# 查看指定运行级别的所有服务
chkconfig --list | grep 3:启用
```

### 3.2 服务启用和禁用命令


**✅ 启用服务**
```bash
# 在默认运行级别启用服务(通常是3和5)
chkconfig httpd on

# 验证设置结果
chkconfig --list httpd
# 结果：httpd  0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
```

**❌ 禁用服务**
```bash
# 在所有运行级别禁用服务
chkconfig httpd off

# 验证设置结果  
chkconfig --list httpd
# 结果：httpd  0:关闭  1:关闭  2:关闭  3:关闭  4:关闭  5:关闭  6:关闭
```

### 3.3 指定运行级别设置


**🎯 精确控制运行级别**
```bash
# 在指定运行级别启用服务
chkconfig --level 35 httpd on
# 含义：仅在运行级别3和5启用httpd服务

# 在指定运行级别禁用服务
chkconfig --level 3 httpd off
# 含义：在运行级别3禁用httpd服务

# 多级别同时设置
chkconfig --level 2345 network on
# 含义：在运行级别2,3,4,5都启用network服务
```

**📊 运行级别设置实例对比**

| 命令 | **效果** | **使用场景** |
|------|---------|-------------|
| `chkconfig httpd on` | 在默认级别(2,3,4,5)启用 | 一般Web服务器 |
| `chkconfig --level 3 httpd on` | 仅在级别3启用 | 仅命令行环境需要 |
| `chkconfig --level 35 httpd on` | 在级别3,5启用 | 命令行和图形环境 |
| `chkconfig --level 2345 httpd on` | 在级别2,3,4,5启用 | 最大兼容性 |

### 3.4 服务管理完整实例


**🔧 典型Web服务配置流程**
```bash
# 1. 查看httpd服务当前状态
chkconfig --list httpd

# 2. 设置httpd服务开机启动
chkconfig httpd on

# 3. 验证设置
chkconfig --list httpd

# 4. 立即启动服务(注意：chkconfig只管开机启动，不管当前状态)
service httpd start

# 5. 检查服务运行状态
service httpd status
```

> 💡 **重要提醒**: chkconfig只控制开机是否启动服务，不控制服务当前的运行状态。要立即启动或停止服务，需要使用`service`命令。

---

## 4. 📁 服务启动目录结构


### 4.1 init.d目录和服务脚本


**🔸 服务脚本位置**
```
/etc/init.d/          ← 所有服务脚本存放目录
├── httpd            ← Apache Web服务器脚本
├── iptables         ← 防火墙服务脚本
├── network          ← 网络服务脚本
├── sshd             ← SSH服务脚本
└── crond            ← 计划任务服务脚本
```

**📋 服务脚本的作用**
每个服务脚本都支持标准的操作参数：
- `start` - 启动服务
- `stop` - 停止服务  
- `restart` - 重启服务
- `status` - 查看状态
- `reload` - 重新加载配置

### 4.2 运行级别目录结构详解


**🏗️ rc.d目录结构图**
```
/etc/rc.d/
├── init.d/              ← 服务脚本原始位置
├── rc0.d/              ← 运行级别0的服务链接
│   ├── K90network      ← K开头表示停止(Kill)
│   └── K99httpd        ← 数字表示执行顺序
├── rc3.d/              ← 运行级别3的服务链接  
│   ├── S10network      ← S开头表示启动(Start)
│   ├── S85httpd        ← 数字越小越先执行
│   └── S90crond
└── rc5.d/              ← 运行级别5的服务链接
    ├── S10network
    ├── S85httpd
    └── S95gdm          ← 图形界面服务
```

### 4.3 符号链接的命名规则


**🔗 链接文件命名解析**
```
格式：[S|K]NN服务名
S85httpd 解析：
├── S      = Start，表示启动
├── 85     = 优先级序号(00-99)
└── httpd  = 服务名称

K90network 解析：  
├── K      = Kill，表示停止
├── 90     = 优先级序号
└── network = 服务名称
```

**⚡ 优先级序号的重要性**
```
启动顺序示例(运行级别3)：
S10network   (优先级10) → 最先启动网络
S25iptables  (优先级25) → 然后启动防火墙
S55sshd      (优先级55) → 接着启动SSH
S85httpd     (优先级85) → 最后启动Web服务

停止顺序示例(关机时)：
K15httpd     (优先级15) → 最先停止Web服务
K45sshd      (优先级45) → 然后停止SSH
K75iptables  (优先级75) → 接着停止防火墙  
K90network   (优先级90) → 最后停止网络
```

---

## 5. 🐧 Debian系统的update-rc.d


### 5.1 update-rc.d基本概念


**🔸 Debian系统差异**
```
Red Hat系列：使用chkconfig
├── CentOS
├── RHEL  
└── Fedora

Debian系列：使用update-rc.d
├── Ubuntu
├── Debian
└── Linux Mint
```

### 5.2 update-rc.d基本用法


**✅ 启用服务**
```bash
# 添加服务到默认运行级别
sudo update-rc.d apache2 defaults

# 指定运行级别启用
sudo update-rc.d apache2 start 80 2 3 4 5 . stop 20 0 1 6 .
# 含义：在级别2,3,4,5优先级80启动，在级别0,1,6优先级20停止
```

**❌ 禁用服务**
```bash
# 移除服务(禁用自启动)
sudo update-rc.d apache2 remove

# 禁用但不删除链接文件
sudo update-rc.d apache2 disable
```

### 5.3 insserv依赖管理工具


**🔧 insserv的作用**
```
功能：智能化服务依赖管理
原理：分析服务脚本中的依赖声明，自动确定启动顺序
优势：避免手动设置优先级数字的复杂性
```

**📋 服务依赖声明示例**
```bash
# 在服务脚本(/etc/init.d/httpd)中的依赖声明：
## BEGIN INIT INFO

# Provides:          httpd
# Required-Start:    $network $syslog
# Required-Stop:     $network $syslog  
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Description:       Apache HTTP Server
## END INIT INFO

```

---

## 6. 🆚 现代systemctl对比转换


### 6.1 传统chkconfig vs 现代systemctl


**📊 命令对照表**

| **功能** | **chkconfig传统方式** | **systemctl现代方式** |
|---------|---------------------|---------------------|
| 查看服务列表 | `chkconfig --list` | `systemctl list-unit-files` |
| 启用开机自启 | `chkconfig httpd on` | `systemctl enable httpd` |
| 禁用开机自启 | `chkconfig httpd off` | `systemctl disable httpd` |
| 查看服务状态 | `chkconfig --list httpd` | `systemctl is-enabled httpd` |
| 立即启动服务 | `service httpd start` | `systemctl start httpd` |
| 立即停止服务 | `service httpd stop` | `systemctl stop httpd` |
| 重启服务 | `service httpd restart` | `systemctl restart httpd` |
| 查看运行状态 | `service httpd status` | `systemctl status httpd` |

### 6.2 系统兼容性说明


**🔄 过渡期兼容**
```
现代Linux发行版(如CentOS 7+, Ubuntu 16+)：
├── 主要使用systemd/systemctl
├── 保留chkconfig兼容性  
└── 建议使用systemctl新命令

传统Linux发行版(如CentOS 6及以前)：
├── 使用System V init
├── 主要命令是chkconfig
└── 无systemctl命令
```

### 6.3 实际转换示例


**🔧 Web服务器配置转换**
```bash
# 传统方式配置Apache
chkconfig --list httpd           # 查看状态
chkconfig httpd on               # 设置开机启动
service httpd start              # 立即启动
service httpd status             # 查看运行状态

# 现代方式配置Apache  
systemctl is-enabled httpd       # 查看是否开机启动
systemctl enable httpd           # 设置开机启动
systemctl start httpd            # 立即启动
systemctl status httpd           # 查看运行状态
```

**🎯 迁移建议**
- 新系统优先使用systemctl
- 脚本兼容性考虑时可同时支持两种方式
- 学习时两种方式都要了解，实际工作中看系统版本

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本概念


```
🔸 chkconfig：传统Linux服务管理工具，控制开机自启动
🔸 运行级别：0-6七个级别，3(命令行)和5(图形)最常用
🔸 服务脚本：位于/etc/init.d/，提供start/stop/status等功能
🔸 符号链接：rc.d目录下的S/K开头链接文件控制启动顺序
🔸 update-rc.d：Debian系统的等价工具
🔸 systemctl：现代Linux的服务管理方式
```

### 7.2 关键理解要点


**🔹 chkconfig只管开机启动，不管当前状态**
```
常见误区：以为chkconfig能立即启动服务
正确理解：
- chkconfig httpd on  → 设置开机启动
- service httpd start → 立即启动服务  
- 两个命令作用不同，通常需要配合使用
```

**🔹 运行级别的实际意义**
```
服务器环境：主要使用运行级别3
- 无图形界面，节省资源
- 网络服务完整，满足服务需求

桌面环境：主要使用运行级别5  
- 包含图形界面
- 适合日常办公使用
```

**🔹 优先级数字的重要性**
```
启动顺序很关键：
- 网络服务(S10) → 防火墙(S25) → 应用服务(S85)
- 依赖关系：后启动的服务通常依赖先启动的服务
- 停止顺序相反：应用服务先停，网络服务最后停
```

### 7.3 实际应用指导


**✅ 服务器常用配置流程**
1. 使用`chkconfig --list`查看当前服务状态
2. 根据需要使用`chkconfig 服务名 on/off`设置开机启动
3. 使用`service 服务名 start`立即启动需要的服务
4. 使用`service 服务名 status`验证服务运行状态

**⚠️ 注意事项**
```
安全考虑：
- 只启动必需的服务，禁用不必要的服务
- 定期检查服务列表，清理无用服务

性能考虑：  
- 服务越少，系统启动越快
- 服务越少，系统资源占用越小

维护考虑：
- 现代系统优先使用systemctl
- 传统系统继续使用chkconfig
```

### 7.4 故障排除思路


```
服务启动问题排查：
1. 检查服务是否设置开机启动：chkconfig --list 服务名
2. 检查服务当前运行状态：service 服务名 status  
3. 查看服务日志：/var/log/对应服务日志
4. 检查配置文件：/etc/对应服务配置文件
5. 检查端口占用：netstat -tlnp | grep 端口号

常见错误解决：
- 服务无法启动 → 检查配置文件语法
- 端口冲突 → 修改端口或停止冲突服务
- 权限问题 → 检查文件权限和SELinux设置
```

**核心记忆**：
- chkconfig管开机启动，service管当前运行
- 运行级别3命令行，5图形界面最常用  
- 服务启动有顺序，依赖关系很重要
- 现代systemctl功能更强，传统chkconfig要了解