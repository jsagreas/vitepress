---
title: 7、预定义服务管理
---
## 📚 目录

1. [firewall-cmd服务管理概述](#1-firewall-cmd服务管理概述)
2. [查看和列出服务](#2-查看和列出服务)
3. [添加和移除服务](#3-添加和移除服务)
4. [常用预定义服务详解](#4-常用预定义服务详解)
5. [服务管理实战示例](#5-服务管理实战示例)
6. [自定义服务创建](#6-自定义服务创建)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔥 firewall-cmd服务管理概述


### 1.1 什么是防火墙服务


**🎯 简单理解**：
想象防火墙服务就像是**门卫规则表**。每个服务（比如网站、邮件、文件传输）都有自己的"通行证"，防火墙根据这个通行证决定是否放行。

```
现实中的门卫：                    防火墙服务：
访客 → 查看通行证 → 放行         数据包 → 检查服务规则 → 允许通过
      ↓                              ↓
   "我是快递员"                   "我是HTTP服务"
   → 允许进入                    → 开放80端口
```

**🔸 核心概念**：
- **服务（Service）**：一组预定义的网络规则，包含端口、协议等信息
- **预定义服务**：系统已经配置好的常用服务（如http、ssh、ftp等）
- **自定义服务**：用户根据需要创建的特殊服务规则

### 1.2 为什么要用服务管理


**传统方式 vs 服务方式**：

```
传统端口管理：
firewall-cmd --add-port=80/tcp     ← 只开放端口80
firewall-cmd --add-port=443/tcp    ← 只开放端口443
firewall-cmd --add-port=8080/tcp   ← 还要记住每个端口

服务方式管理：
firewall-cmd --add-service=http    ← 自动开放80端口
firewall-cmd --add-service=https   ← 自动开放443端口
firewall-cmd --add-service=http-alt ← 自动开放8080端口
```

**🌟 服务管理的优势**：
- **更直观**：用服务名代替端口号，一看就懂
- **更安全**：只开放服务需要的端口，不会多开
- **更方便**：一个命令解决多个端口的配置
- **更专业**：符合网络管理的标准做法

---

## 2. 🔍 查看和列出服务


### 2.1 列出所有可用服务


**命令格式**：
```bash
firewall-cmd --get-services
```

**🔸 实际效果**：
```bash
# 查看系统中所有预定义的服务
[root@server ~]# firewall-cmd --get-services
amanda-client amanda-k5-client bacula bacula-client bitcoin bitcoin-rpc ... ssh telnet tftp http https ...

# 输出结果说明：
# 这一长串就是系统预定义的所有服务名称
# 包含了从常用的http、ssh到专业的数据库、邮件等服务
```

> 💡 **新手提示**：这个命令会输出很多服务名，不用记住全部，只需要了解常用的几十个即可。

### 2.2 查看当前区域的服务


**查看默认区域的服务**：
```bash
firewall-cmd --list-services
```

**查看指定区域的服务**：
```bash
firewall-cmd --zone=public --list-services
```

**🎯 示例演示**：
```bash
# 查看默认区域当前开放的服务
[root@server ~]# firewall-cmd --list-services
dhcpv6-client ssh

# 解读结果：
# dhcpv6-client → 允许自动获取IPv6地址
# ssh → 允许SSH远程登录（端口22）
```

### 2.3 服务的详细信息


**查看服务包含的端口**：
```bash
firewall-cmd --info-service=服务名
```

**🔧 实用示例**：
```bash
# 查看http服务的详细信息
[root@server ~]# firewall-cmd --info-service=http
http
  ports: 80/tcp
  protocols: 
  source-ports: 
  modules: 
  destination: 

# 查看https服务的详细信息  
[root@server ~]# firewall-cmd --info-service=https
https
  ports: 443/tcp
  protocols: 
  source-ports: 
  modules: 
  destination:
```

> 📚 **知识扩展**：每个服务本质上就是端口+协议的组合，`--info-service`帮你看到服务背后的具体配置。

---

## 3. ➕ 添加和移除服务


### 3.1 临时添加服务


**基本语法**：
```bash
firewall-cmd --add-service=服务名
```

**🎯 实战示例**：
```bash
# 临时开放HTTP服务（网站访问）
firewall-cmd --add-service=http

# 临时开放HTTPS服务（安全网站访问）
firewall-cmd --add-service=https

# 临时开放FTP服务（文件传输）
firewall-cmd --add-service=ftp
```

> ⚠️ **重要提醒**：临时添加的服务在防火墙重启后会失效，如果需要永久生效，必须加上`--permanent`参数。

### 3.2 永久添加服务


**永久添加语法**：
```bash
firewall-cmd --permanent --add-service=服务名
firewall-cmd --reload  # 重新加载配置使其生效
```

**📋 完整操作流程**：
```bash
# 第一步：永久添加HTTP服务
[root@server ~]# firewall-cmd --permanent --add-service=http
success

# 第二步：重新加载防火墙配置
[root@server ~]# firewall-cmd --reload
success

# 第三步：验证服务是否添加成功
[root@server ~]# firewall-cmd --list-services
dhcpv6-client ssh http
```

### 3.3 移除服务


**临时移除**：
```bash
firewall-cmd --remove-service=服务名
```

**永久移除**：
```bash
firewall-cmd --permanent --remove-service=服务名
firewall-cmd --reload
```

**🔧 移除示例**：
```bash
# 临时关闭FTP服务
firewall-cmd --remove-service=ftp

# 永久关闭FTP服务
firewall-cmd --permanent --remove-service=ftp
firewall-cmd --reload
```

### 3.4 同时操作多个服务


**批量添加服务**：
```bash
# 一次性添加多个服务
firewall-cmd --add-service={http,https,ssh}

# 永久批量添加
firewall-cmd --permanent --add-service={http,https,ftp}
firewall-cmd --reload
```

---

## 4. 🌐 常用预定义服务详解


### 4.1 Web服务类


| 服务名称 | **对应端口** | **实际用途** | **使用场景** |
|---------|-------------|-------------|-------------|
| `http` | `80/tcp` | `网站HTTP访问` | `所有网站的基础服务` |
| `https` | `443/tcp` | `网站HTTPS安全访问` | `现代网站的标配服务` |
| `http-alt` | `8080/tcp` | `备用HTTP端口` | `测试环境、代理服务` |

**🌐 Web服务配置示例**：
```bash
# 开放标准网站服务
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload

# 验证网站服务状态
curl -I http://你的服务器IP    # 测试HTTP访问
curl -I https://你的服务器IP   # 测试HTTPS访问
```

### 4.2 远程管理类


| 服务名称 | **对应端口** | **实际用途** | **安全级别** |
|---------|-------------|-------------|-------------|
| `ssh` | `22/tcp` | `安全远程登录` | `🟢 高安全` |
| `telnet` | `23/tcp` | `明文远程登录` | `🔴 不安全` |
| `vnc-server` | `5900/tcp` | `图形界面远程控制` | `🟡 中等` |

**🔐 远程管理配置**：
```bash
# SSH是必备的，通常默认开启
firewall-cmd --list-services | grep ssh

# 如果没有SSH，立即添加（否则可能断连）
firewall-cmd --permanent --add-service=ssh
firewall-cmd --reload
```

> 🚨 **安全警告**：永远不要在生产环境移除SSH服务，否则可能无法远程连接服务器！

### 4.3 文件传输类


| 服务名称 | **对应端口** | **传输方式** | **适用场景** |
|---------|-------------|-------------|-------------|
| `ftp` | `21/tcp` | `标准FTP传输` | `大文件上传下载` |
| `ftp-data` | `20/tcp` | `FTP数据传输` | `配合FTP使用` |
| `sftp` | `22/tcp` | `安全文件传输` | `推荐的文件传输方式` |

**📁 FTP服务配置**：
```bash
# 开放FTP服务（需要同时开放控制和数据端口）
firewall-cmd --permanent --add-service=ftp
firewall-cmd --reload

# FTP的工作原理图：
# 客户端 --[控制连接 21端口]--> FTP服务器
# 客户端 <--[数据传输 20端口]-- FTP服务器
```

### 4.4 邮件服务类


| 服务名称 | **对应端口** | **服务功能** | **协议类型** |
|---------|-------------|-------------|-------------|
| `smtp` | `25/tcp` | `邮件发送` | `简单邮件传输协议` |
| `pop3` | `110/tcp` | `邮件接收` | `邮局协议第3版` |
| `imap` | `143/tcp` | `邮件管理` | `互联网消息访问协议` |
| `smtps` | `465/tcp` | `安全邮件发送` | `SSL加密的SMTP` |

**✉️ 邮件服务器配置**：
```bash
# 配置完整的邮件服务器
firewall-cmd --permanent --add-service={smtp,pop3,imap}
firewall-cmd --reload

# 邮件服务的工作流程：
# 发送邮件：客户端 → SMTP(25) → 邮件服务器
# 接收邮件：客户端 ← POP3(110)/IMAP(143) ← 邮件服务器
```

### 4.5 数据库服务类


| 服务名称 | **对应端口** | **数据库类型** | **使用建议** |
|---------|-------------|-------------|-------------|
| `mysql` | `3306/tcp` | `MySQL/MariaDB` | `仅内网开放` |
| `postgresql` | `5432/tcp` | `PostgreSQL` | `仅内网开放` |
| `redis` | `6379/tcp` | `Redis缓存` | `仅内网开放` |

**🗄️ 数据库安全配置**：
```bash
# 数据库服务通常只对内网开放
firewall-cmd --permanent --zone=internal --add-service=mysql
firewall-cmd --reload

# 数据库安全原则：
# ✅ 只对内网开放
# ✅ 使用强密码
# ✅ 定期备份数据
# ❌ 不要对公网开放数据库端口
```

### 4.6 DNS服务类


**🌐 DNS服务配置**：
```bash
# DNS服务器配置
firewall-cmd --permanent --add-service=dns
firewall-cmd --reload

# DNS的工作示意：
# 客户端查询：www.example.com → DNS服务器(53端口) → 返回IP地址
```

---

## 5. 🛠️ 服务管理实战示例


### 5.1 Web服务器完整配置


**场景**：配置一个完整的Web服务器，支持HTTP和HTTPS访问

```bash
# 第一步：查看当前状态
firewall-cmd --list-services

# 第二步：添加Web服务
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https

# 第三步：重新加载配置
firewall-cmd --reload

# 第四步：验证配置
firewall-cmd --list-services
# 输出应该包含：http https

# 第五步：测试连接
curl -I http://localhost     # 测试HTTP
curl -I https://localhost    # 测试HTTPS（需要SSL证书）
```

**🎯 配置效果图**：
```
防火墙配置前：
外网 ✗→ [防火墙] ✗→ Web服务器
     拒绝      拒绝

防火墙配置后：
外网 ✓→ [防火墙] ✓→ Web服务器
     允许      允许
   80/443端口  HTTP/HTTPS服务
```

### 5.2 开发环境配置


**场景**：为开发测试配置多种服务

```bash
# 开发环境常用服务包
SERVICES="http https ssh ftp mysql"

# 批量添加服务
firewall-cmd --permanent --add-service={http,https,ssh,ftp,mysql}
firewall-cmd --reload

# 验证所有服务
echo "当前开放的服务："
firewall-cmd --list-services
```

### 5.3 邮件服务器配置


**场景**：配置企业邮件服务器

```bash
# 邮件服务器完整配置
firewall-cmd --permanent --add-service=smtp     # 发送邮件
firewall-cmd --permanent --add-service=smtps    # 安全发送
firewall-cmd --permanent --add-service=pop3     # 接收邮件
firewall-cmd --permanent --add-service=imap     # 邮件管理
firewall-cmd --reload

# 配置验证
firewall-cmd --list-services | grep -E "smtp|pop|imap"
```

### 5.4 故障排查示例


**问题**：网站无法访问

**🔍 排查步骤**：
```bash
# 第一步：检查防火墙服务状态
systemctl status firewalld

# 第二步：检查当前开放的服务
firewall-cmd --list-services

# 第三步：检查HTTP服务是否开放
firewall-cmd --list-services | grep http

# 第四步：如果没有HTTP，立即添加
if ! firewall-cmd --list-services | grep -q http; then
    echo "HTTP服务未开放，正在添加..."
    firewall-cmd --permanent --add-service=http
    firewall-cmd --reload
    echo "HTTP服务已开放"
fi

# 第五步：测试连接
curl -I http://localhost
```

---

## 6. 🎨 自定义服务创建


### 6.1 为什么需要自定义服务


**🤔 什么时候需要自定义服务？**
- 使用**非标准端口**的应用程序
- **组合多个端口**的复杂服务
- 创建**特定业务**的服务规则

**实际案例**：
```
案例1：Jenkins CI/CD服务器
默认端口：8080（与http-alt冲突）
需要端口：8080/tcp + 50000/tcp

案例2：游戏服务器
需要端口：7777/tcp + 7777/udp + 27015/udp

案例3：自建应用
需要端口：9999/tcp + 8888/tcp
```

### 6.2 自定义服务创建步骤


**📋 创建流程**：

① **创建服务配置文件**
② **定义端口和协议**  
③**重新加载防火墙**
④ **测试服务可用性**

**🔧 实际操作示例**：

```bash
# 第一步：创建Jenkins自定义服务
cat > /etc/firewalld/services/jenkins.xml << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<service>
  <short>Jenkins</short>
  <description>Jenkins CI/CD Server</description>
  <port protocol="tcp" port="8080"/>
  <port protocol="tcp" port="50000"/>
</service>
EOF

# 第二步：重新加载防火墙配置
firewall-cmd --reload

# 第三步：验证自定义服务
firewall-cmd --get-services | grep jenkins

# 第四步：添加自定义服务到防火墙
firewall-cmd --permanent --add-service=jenkins
firewall-cmd --reload
```

### 6.3 自定义服务配置详解


**📝 XML配置文件格式**：
```xml
<?xml version="1.0" encoding="utf-8"?>
<service>
  <short>服务简称</short>
  <description>服务详细描述</description>
  <port protocol="tcp" port="端口号"/>
  <port protocol="udp" port="端口号"/>
  <!-- 可以定义多个端口 -->
</service>
```

**🎯 复杂服务示例**：
```bash
# 创建游戏服务器配置
cat > /etc/firewalld/services/gameserver.xml << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<service>
  <short>GameServer</short>
  <description>Custom Game Server with multiple ports</description>
  <port protocol="tcp" port="7777"/>
  <port protocol="udp" port="7777"/>
  <port protocol="udp" port="27015"/>
  <port protocol="tcp" port="8080"/>
</service>
EOF
```

### 6.4 自定义服务管理


**查看自定义服务**：
```bash
# 查看服务配置文件位置
ls /etc/firewalld/services/

# 查看自定义服务详情
firewall-cmd --info-service=jenkins
```

**修改自定义服务**：
```bash
# 修改配置文件
vim /etc/firewalld/services/jenkins.xml

# 重新加载配置
firewall-cmd --reload
```

**删除自定义服务**：
```bash
# 先从防火墙移除
firewall-cmd --permanent --remove-service=jenkins

# 删除配置文件
rm /etc/firewalld/services/jenkins.xml

# 重新加载
firewall-cmd --reload
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本命令


```bash
🔸 查看所有服务：firewall-cmd --get-services
🔸 列出当前服务：firewall-cmd --list-services  
🔸 添加服务：firewall-cmd --add-service=服务名
🔸 永久添加：firewall-cmd --permanent --add-service=服务名
🔸 移除服务：firewall-cmd --remove-service=服务名
🔸 服务详情：firewall-cmd --info-service=服务名
🔸 重新加载：firewall-cmd --reload
```

### 7.2 常用服务速查表


| **服务类型** | **服务名** | **端口** | **使用频率** |
|-------------|-----------|----------|-------------|
| **Web服务** | `http` | `80/tcp` | ⭐⭐⭐⭐⭐ |
| **安全Web** | `https` | `443/tcp` | ⭐⭐⭐⭐⭐ |
| **远程管理** | `ssh` | `22/tcp` | ⭐⭐⭐⭐⭐ |
| **文件传输** | `ftp` | `21/tcp` | ⭐⭐⭐☆☆ |
| **邮件发送** | `smtp` | `25/tcp` | ⭐⭐⭐☆☆ |
| **数据库** | `mysql` | `3306/tcp` | ⭐⭐⭐⭐☆ |

### 7.3 关键理解要点


**🔹 服务 vs 端口的关系**：
- **服务**是**端口的集合**，一个服务可能包含多个端口
- 使用服务比直接开放端口更**安全**、更**规范**
- 服务名比端口号更**直观**、更好**记忆**

**🔹 临时 vs 永久配置**：
```
临时配置：立即生效，重启后失效
永久配置：需要reload，重启后仍然有效

生产环境建议：先测试临时配置，确认无误后再永久配置
```

**🔹 安全配置原则**：
- **最小权限原则**：只开放必要的服务
- **分层防护**：结合区域和服务配置
- **定期审查**：定期检查开放的服务是否合理

### 7.4 实际应用建议


**📚 新手学习路径**：
1. **先掌握查看命令**：学会查看当前状态
2. **练习常用服务**：http、https、ssh等
3. **理解临时永久**：掌握配置的生效方式  
4. **学会故障排查**：当服务无法访问时的检查方法
5. **进阶自定义**：根据需要创建自定义服务

**⚡ 日常使用技巧**：
```bash
# 快速检查Web服务状态
firewall-cmd --list-services | grep -E "http|https"

# 批量操作多个服务
firewall-cmd --permanent --add-service={http,https,ssh}

# 安全地添加服务（先临时测试）
firewall-cmd --add-service=mysql  # 临时测试
# 确认无问题后再永久添加
firewall-cmd --permanent --add-service=mysql
```

**🔧 故障排查思路**：
```
服务无法访问时的检查顺序：
1. 检查服务本身是否运行
2. 检查防火墙是否开放对应服务
3. 检查网络连接是否正常
4. 检查应用程序配置是否正确
```

**核心记忆口诀**：
- 服务管理更直观，端口配置不用记
- 临时测试永久用，reload重载别忘记  
- 安全第一最小化，定期检查要牢记
- 自定义服务解特需，XML配置有规律