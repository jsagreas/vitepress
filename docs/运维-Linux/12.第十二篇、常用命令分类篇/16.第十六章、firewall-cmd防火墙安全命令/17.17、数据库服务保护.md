---
title: 17、数据库服务保护
---
## 📚 目录

1. [数据库防火墙保护基础](#1-数据库防火墙保护基础)
2. [数据库端口访问限制](#2-数据库端口访问限制)
3. [应用服务器白名单配置](#3-应用服务器白名单配置)
4. [管理工具访问控制](#4-管理工具访问控制)
5. [备份端口安全设置](#5-备份端口安全设置)
6. [监控端口开放配置](#6-监控端口开放配置)
7. [数据库集群通信保护](#7-数据库集群通信保护)
8. [读写分离网络配置](#8-读写分离网络配置)
9. [数据传输加密配置](#9-数据传输加密配置)
10. [实战场景演练](#10-实战场景演练)
11. [核心要点总结](#11-核心要点总结)

---

## 1. 🛡️ 数据库防火墙保护基础


### 1.1 为什么数据库需要防火墙保护


**🔸 数据库面临的安全威胁**
```
想象一下你家里的保险箱：
- 你不会把保险箱放在大街上让任何人都能碰到
- 数据库就像是公司的"保险箱"，存放着最重要的数据
- 防火墙就像是保险箱外面的"保安"，决定谁能接近

常见的数据库安全问题：
❌ 默认端口直接暴露在公网上
❌ 任何IP都能尝试连接数据库
❌ 缺少网络层面的访问控制
❌ 管理端口没有额外保护
```

**💡 防火墙保护的核心原理**
```
防火墙保护数据库的三个层面：

网络隔离：
- 只允许指定的服务器连接数据库
- 拒绝来自互联网的直接连接
- 按照业务需求开放最小权限

端口控制：
- 只开放必要的数据库端口
- 关闭不必要的管理端口
- 为不同用途设置不同的访问规则

源IP限制：
- 应用服务器：允许业务连接
- 管理员IP：允许管理连接
- 其他IP：一律拒绝
```

### 1.2 数据库常用端口说明


**📋 主流数据库端口列表**
| 数据库类型 | **默认端口** | **用途说明** | **安全级别** |
|------------|-------------|-------------|-------------|
| **MySQL** | `3306` | 主要连接端口 | 🔴 高风险 |
| **PostgreSQL** | `5432` | 主要连接端口 | 🔴 高风险 |
| **Oracle** | `1521` | 监听器端口 | 🔴 高风险 |
| **SQL Server** | `1433` | 主连接端口 | 🔴 高风险 |
| **MongoDB** | `27017` | 默认连接端口 | 🔴 高风险 |
| **Redis** | `6379` | 内存数据库 | 🟡 中风险 |

### 1.3 数据库网络架构规划


**🏗️ 典型的数据库网络布局**
```
互联网
    |
    v
前端服务器（Web Server）
    |
    v
应用服务器（App Server）
    |
    v
数据库服务器（Database Server）

防火墙规则设计原则：
- 前端服务器：只能访问应用服务器
- 应用服务器：只能访问数据库服务器
- 数据库服务器：不能主动对外连接
- 管理员：通过跳板机访问所有服务器
```

---

## 2. 🔐 数据库端口访问限制


### 2.1 基础端口控制策略


**🔸 MySQL数据库端口保护**

首先了解当前防火墙状态：
```bash
# 查看防火墙是否启用
sudo firewall-cmd --state

# 查看当前开放的端口
sudo firewall-cmd --list-ports
```

为MySQL设置基本的端口保护：
```bash
# 第一步：关闭MySQL的公网访问（如果之前开放过）
sudo firewall-cmd --remove-port=3306/tcp --permanent

# 第二步：只允许特定网段访问MySQL
# 假设应用服务器在192.168.1.0/24网段
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="3306" protocol="tcp" 
  accept'

# 重新加载规则使其生效
sudo firewall-cmd --reload
```

**🔸 PostgreSQL数据库端口保护**
```bash
# PostgreSQL使用5432端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="5432" protocol="tcp" 
  accept'

# 如果有多个应用服务器，可以添加多条规则
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.101" 
  port port="5432" protocol="tcp" 
  accept'

sudo firewall-cmd --reload
```

### 2.2 端口访问验证方法


**🔍 测试端口访问控制效果**

从允许的IP测试连接：
```bash
# 在应用服务器上测试（应该成功）
telnet 192.168.1.200 3306

# 使用MySQL客户端测试
mysql -h 192.168.1.200 -u testuser -p
```

从不允许的IP测试连接：
```bash
# 在其他服务器上测试（应该失败）
telnet 192.168.1.200 3306
# 期望结果：连接超时或被拒绝
```

**💡 常用的连接测试工具**
```bash
# 使用nmap扫描端口状态
nmap -p 3306 192.168.1.200

# 使用nc（netcat）测试连接
nc -zv 192.168.1.200 3306

# 查看防火墙日志确认规则生效
sudo journalctl -u firewalld | grep 3306
```

### 2.3 动态端口管理


**⚙️ 临时开放端口进行维护**

有时需要临时开放端口进行紧急维护：
```bash
# 临时开放MySQL端口（重启后失效）
sudo firewall-cmd --add-port=3306/tcp

# 查看临时规则
sudo firewall-cmd --list-ports

# 如果需要撤销临时规则
sudo firewall-cmd --remove-port=3306/tcp
```

为特定IP临时开放端口：
```bash
# 为运维人员临时开放数据库访问
sudo firewall-cmd --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.100" 
  port port="3306" protocol="tcp" 
  accept'

# 维护完成后移除规则
sudo firewall-cmd --remove-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.100" 
  port port="3306" protocol="tcp" 
  accept'
```

---

## 3. 📋 应用服务器白名单配置


### 3.1 理解白名单机制


**🔸 什么是白名单**
```
白名单就像是"贵宾名单"：
- 只有名单上的客人才能进入
- 不在名单上的一律不准进入
- 比黑名单更安全，因为默认就是拒绝所有

在数据库保护中：
✅ 白名单内的IP：可以访问数据库
❌ 白名单外的IP：一律拒绝访问
```

### 3.2 单个应用服务器配置


**📱 为单个应用服务器配置数据库访问**

假设你有一个Web应用服务器需要访问MySQL数据库：
```bash
# 应用服务器IP：192.168.1.100
# 数据库服务器IP：192.168.1.200

# 在数据库服务器上执行以下命令：
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="3306" protocol="tcp" 
  accept'

# 如果还需要其他端口（比如MySQL的管理端口）
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="33060" protocol="tcp" 
  accept'

sudo firewall-cmd --reload
```

### 3.3 多个应用服务器配置


**🏢 企业环境中的多服务器场景**

通常企业会有多个应用服务器需要访问同一个数据库：
```bash
# 方法1：逐个添加每台服务器
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" source address="192.168.1.100" 
  port port="3306" protocol="tcp" accept'

sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" source address="192.168.1.101" 
  port port="3306" protocol="tcp" accept'

sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" source address="192.168.1.102" 
  port port="3306" protocol="tcp" accept'
```

**🌐 使用网段简化配置**

如果应用服务器都在同一个网段，可以使用网段配置：
```bash
# 允许整个应用服务器网段访问
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="3306" protocol="tcp" 
  accept'

# 更精确的子网配置（只允许.100-.110这个范围）
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100/29" 
  port port="3306" protocol="tcp" 
  accept'
```

### 3.4 基于端口的细粒度控制


**🎯 不同应用使用不同端口**

有时候不同的应用需要不同级别的数据库访问权限：
```bash
# Web应用：只能访问主数据库端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="3306" protocol="tcp" 
  accept'

# 报表应用：可以访问只读副本端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.105" 
  port port="3307" protocol="tcp" 
  accept'

# API服务：可以访问缓存数据库
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.110" 
  port port="6379" protocol="tcp" 
  accept'
```

### 3.5 白名单管理最佳实践


**📝 创建白名单管理脚本**

为了方便管理白名单，可以创建一个管理脚本：
```bash
#!/bin/bash
# 数据库白名单管理脚本

DB_PORT="3306"
ACTION=$1
IP_ADDRESS=$2

case $ACTION in
  "add")
    echo "添加IP $IP_ADDRESS 到数据库白名单..."
    sudo firewall-cmd --permanent --add-rich-rule="
      rule family='ipv4' 
      source address='$IP_ADDRESS' 
      port port='$DB_PORT' protocol='tcp' 
      accept"
    sudo firewall-cmd --reload
    echo "白名单已更新"
    ;;
  "remove")
    echo "从白名单中移除IP $IP_ADDRESS..."
    sudo firewall-cmd --permanent --remove-rich-rule="
      rule family='ipv4' 
      source address='$IP_ADDRESS' 
      port port='$DB_PORT' protocol='tcp' 
      accept"
    sudo firewall-cmd --reload
    echo "IP已从白名单移除"
    ;;
  "list")
    echo "当前数据库白名单："
    sudo firewall-cmd --list-rich-rules | grep "$DB_PORT"
    ;;
  *)
    echo "用法：$0 {add|remove|list} [IP地址]"
    ;;
esac
```

使用方法：
```bash
# 添加新的应用服务器到白名单
chmod +x db_whitelist.sh
./db_whitelist.sh add 192.168.1.120

# 查看当前白名单
./db_whitelist.sh list

# 移除不再需要的服务器
./db_whitelist.sh remove 192.168.1.120
```

---

## 4. 🔧 管理工具访问控制


### 4.1 管理端口的安全考量


**🔸 为什么管理端口需要特殊保护**
```
管理端口就像是"后门钥匙"：
- 通过管理端口可以完全控制数据库
- 一旦被恶意利用，后果不堪设想
- 需要比普通业务端口更严格的保护

常见的数据库管理端口：
- MySQL: 33060 (X Protocol)
- PostgreSQL: 5432 (同时也是业务端口)
- Oracle: 1158 (Enterprise Manager)
- MongoDB: 27017 (同时也是业务端口)
```

### 4.2 DBA专用访问通道


**👨‍💼 为数据库管理员创建专用访问规则**

只允许DBA的办公IP访问管理端口：
```bash
# 假设DBA的办公网络是203.0.113.0/24
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.0/24" 
  port port="3306" protocol="tcp" 
  accept'

# 如果有MySQL的X Protocol管理端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.0/24" 
  port port="33060" protocol="tcp" 
  accept'
```

**🏠 为特定DBA个人IP创建规则**
```bash
# DBA张三的家庭IP
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.100" 
  port port="3306" protocol="tcp" 
  accept'

# DBA李四的办公室IP
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.101" 
  port port="3306" protocol="tcp" 
  accept'
```

### 4.3 管理工具专用端口配置


**🛠️ 常用数据库管理工具的防火墙配置**

**phpMyAdmin Web管理界面：**
```bash
# phpMyAdmin通常使用HTTP/HTTPS端口
# 只允许管理员网段访问
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.0/24" 
  port port="80" protocol="tcp" 
  accept'

sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.0/24" 
  port port="443" protocol="tcp" 
  accept'
```

**Navicat等桌面管理工具：**
```bash
# 桌面工具直接连接数据库端口
# 可以为管理工具创建特殊的时间限制
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.100" 
  port port="3306" protocol="tcp" 
  accept'
```

### 4.4 基于时间的管理访问


**⏰ 限制管理访问的时间窗口**

只在工作时间允许管理访问：
```bash
# 周一到周五，上午9点到下午6点允许管理访问
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.0/24" 
  port port="3306" protocol="tcp" 
  time start="09:00" stop="18:00" weekday="mon,tue,wed,thu,fri"
  accept'
```

**🚨 紧急维护时的临时访问**
```bash
# 紧急情况下临时开放管理访问
sudo firewall-cmd --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.100" 
  port port="3306" protocol="tcp" 
  accept'

# 维护完成后立即关闭
sudo firewall-cmd --remove-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.100" 
  port port="3306" protocol="tcp" 
  accept'
```

### 4.5 跳板机访问模式


**🚪 通过跳板机访问数据库**

更安全的做法是通过跳板机访问：
```bash
# 只允许跳板机访问数据库
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.10" 
  port port="3306" protocol="tcp" 
  accept'

# 管理员先SSH到跳板机，再从跳板机访问数据库
# 这样可以记录所有的操作日志
```

跳板机的防火墙配置：
```bash
# 在跳板机上，只允许管理员IP SSH访问
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="203.0.113.0/24" 
  port port="22" protocol="tcp" 
  accept'
```

---

## 5. 💾 备份端口安全设置


### 5.1 数据库备份网络需求


**🔸 备份操作的网络特点**
```
数据库备份就像是"搬家"：
- 需要把大量数据从数据库传输到备份服务器
- 传输过程需要稳定的网络连接
- 备份服务器需要能够连接到数据库
- 但是备份完成后，连接就可以断开

备份网络的安全要求：
✅ 备份服务器能够连接数据库
✅ 备份传输过程要加密
✅ 备份完成后及时断开连接
❌ 不允许从备份服务器进行其他数据库操作
```

### 5.2 备份服务器访问配置


**📦 为备份服务器配置数据库访问权限**

假设备份服务器IP是192.168.2.100：
```bash
# 允许备份服务器访问MySQL
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.2.100" 
  port port="3306" protocol="tcp" 
  accept'

# 如果使用MySQL的备份专用端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.2.100" 
  port port="33061" protocol="tcp" 
  accept'

sudo firewall-cmd --reload
```

### 5.3 定时备份的网络控制


**⏰ 基于时间的备份端口开放**

只在备份时间开放备份端口：
```bash
# 每天凌晨2点到4点开放备份端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.2.100" 
  port port="3306" protocol="tcp" 
  time start="02:00" stop="04:00"
  accept'
```

**📝 备份专用脚本示例**

创建一个智能的备份防火墙脚本：
```bash
#!/bin/bash
# 备份防火墙控制脚本

BACKUP_SERVER="192.168.2.100"
DB_PORT="3306"

start_backup() {
    echo "开放备份端口..."
    sudo firewall-cmd --add-rich-rule="
      rule family='ipv4' 
      source address='$BACKUP_SERVER' 
      port port='$DB_PORT' protocol='tcp' 
      accept"
    echo "备份端口已开放，可以开始备份"
}

stop_backup() {
    echo "关闭备份端口..."
    sudo firewall-cmd --remove-rich-rule="
      rule family='ipv4' 
      source address='$BACKUP_SERVER' 
      port port='$DB_PORT' protocol='tcp' 
      accept"
    echo "备份端口已关闭"
}

case $1 in
    "start") start_backup ;;
    "stop") stop_backup ;;
    *) echo "用法: $0 {start|stop}" ;;
esac
```

### 5.4 备份网络隔离


**🌐 创建备份专用网络**

为了更好的安全性，可以创建备份专用的网络：
```bash
# 创建备份专用zone
sudo firewall-cmd --permanent --new-zone=backup-zone

# 将备份网段添加到专用zone
sudo firewall-cmd --permanent --zone=backup-zone --add-source=192.168.2.0/24

# 在备份zone中只允许数据库备份端口
sudo firewall-cmd --permanent --zone=backup-zone --add-port=3306/tcp

# 重新加载配置
sudo firewall-cmd --reload

# 查看备份zone配置
sudo firewall-cmd --zone=backup-zone --list-all
```

### 5.5 备份传输加密支持


**🔐 支持加密备份传输**

为使用SSL/TLS的备份连接开放端口：
```bash
# MySQL SSL连接使用相同端口，但需要证书
# 确保防火墙规则支持SSL连接
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.2.100" 
  port port="3306" protocol="tcp" 
  accept'

# 如果使用SSH隧道进行备份
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.2.100" 
  port port="22" protocol="tcp" 
  accept'
```

**📊 备份端口使用监控**
```bash
# 监控备份端口的连接情况
sudo ss -tulpn | grep :3306

# 查看防火墙日志中的备份连接记录
sudo journalctl -u firewalld | grep "192.168.2.100"
```

---

## 6. 📊 监控端口开放配置


### 6.1 数据库监控的重要性


**🔸 为什么需要监控数据库**
```
数据库监控就像是"健康体检"：
- 及时发现数据库性能问题
- 监控数据库的连接状态
- 预警磁盘空间不足等问题
- 记录数据库的使用情况

监控工具需要的网络权限：
✅ 能够连接数据库获取状态信息
✅ 能够收集性能指标数据
✅ 能够发送告警信息
❌ 不应该有修改数据库的权限
```

### 6.2 监控服务器访问配置


**📈 为监控系统配置数据库访问**

假设监控服务器IP是192.168.3.100：
```bash
# 允许监控服务器访问MySQL状态信息
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="3306" protocol="tcp" 
  accept'

# 如果使用专门的监控端口（如MySQL Enterprise Monitor）
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="6446" protocol="tcp" 
  accept'
```

### 6.3 常用监控工具的端口配置


**🛠️ 不同监控工具的防火墙设置**

**Zabbix监控系统：**
```bash
# Zabbix Agent端口（被监控端）
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="10050" protocol="tcp" 
  accept'

# Zabbix主动模式端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="10051" protocol="tcp" 
  accept'
```

**Prometheus + MySQL Exporter：**
```bash
# MySQL Exporter默认端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="9104" protocol="tcp" 
  accept'

# Prometheus抓取端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="9090" protocol="tcp" 
  accept'
```

**Nagios监控：**
```bash
# NRPE端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="5666" protocol="tcp" 
  accept'
```

### 6.4 监控端口的安全加固


**🔒 监控端口的额外安全措施**

限制监控访问的频率：
```bash
# 使用连接限制防止监控工具过于频繁的连接
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="3306" protocol="tcp" 
  limit value="10/m" 
  accept'
```

**📊 监控专用zone配置**
```bash
# 创建监控专用zone
sudo firewall-cmd --permanent --new-zone=monitoring-zone

# 添加监控网段
sudo firewall-cmd --permanent --zone=monitoring-zone --add-source=192.168.3.0/24

# 只允许监控相关端口
sudo firewall-cmd --permanent --zone=monitoring-zone --add-port=3306/tcp
sudo firewall-cmd --permanent --zone=monitoring-zone --add-port=9104/tcp
sudo firewall-cmd --permanent --zone=monitoring-zone --add-port=10050/tcp

sudo firewall-cmd --reload
```

### 6.5 监控端口状态检查


**🔍 验证监控端口配置**

检查监控连接是否正常：
```bash
# 在监控服务器上测试数据库连接
mysql -h 192.168.1.200 -u monitor_user -p -e "SHOW STATUS"

# 测试MySQL Exporter端口
curl http://192.168.1.200:9104/metrics

# 检查防火墙规则是否生效
sudo firewall-cmd --list-rich-rules | grep "192.168.3.100"
```

---

## 7. 🔗 数据库集群通信保护


### 7.1 数据库集群网络架构


**🔸 理解数据库集群的通信需求**
```
数据库集群就像是"团队协作"：
- 主数据库（Master）：负责写操作
- 从数据库（Slave）：负责读操作和备份
- 它们之间需要持续的数据同步通信
- 还需要心跳检测确认彼此状态

集群通信的网络要求：
✅ 主从服务器之间能够互相通信
✅ 集群管理器能够监控所有节点
✅ 客户端能够访问集群的虚拟IP
❌ 外部不能直接访问集群内部通信
```

### 7.2 MySQL主从复制防火墙配置


**🔄 MySQL主从复制的网络设置**

假设有以下MySQL集群：
- 主服务器：192.168.1.200
- 从服务器1：192.168.1.201
- 从服务器2：192.168.1.202

**在主服务器(192.168.1.200)上配置：**
```bash
# 允许从服务器连接进行数据同步
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.201" 
  port port="3306" protocol="tcp" 
  accept'

sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.202" 
  port port="3306" protocol="tcp" 
  accept'
```

**在从服务器上配置：**
```bash
# 从服务器需要能够连接主服务器
# 通常从服务器是主动连接主服务器，所以主服务器不需要连接从服务器
# 但是为了集群管理，可能需要双向通信

# 在从服务器1(192.168.1.201)上
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.200" 
  port port="3306" protocol="tcp" 
  accept'
```

### 7.3 MySQL Group Replication集群


**🌐 MySQL Group Replication的网络配置**

Group Replication需要额外的通信端口：
```bash
# MySQL Group Replication通信端口（默认33061）
# 在所有集群节点上都需要配置

# 节点1 (192.168.1.200) 允许其他节点连接
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.201" 
  port port="33061" protocol="tcp" 
  accept'

sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.202" 
  port port="33061" protocol="tcp" 
  accept'

# 类似地在其他节点上也要配置
```

**📊 集群状态监控端口：**
```bash
# MySQL InnoDB Cluster管理端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="6446" protocol="tcp" 
  accept'

# MySQL Router端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="6447" protocol="tcp" 
  accept'
```

### 7.4 PostgreSQL集群配置


**🐘 PostgreSQL流复制的防火墙设置**

PostgreSQL主从集群配置：
```bash
# 主服务器允许从服务器连接进行流复制
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.211" 
  port port="5432" protocol="tcp" 
  accept'

# 如果使用WAL传输
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.211" 
  port port="5432" protocol="tcp" 
  accept'
```

**🔄 PostgreSQL Patroni集群：**
```bash
# Patroni REST API端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="8008" protocol="tcp" 
  accept'

# etcd集群通信端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="2379" protocol="tcp" 
  accept'

sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="2380" protocol="tcp" 
  accept'
```

### 7.5 集群网络安全策略


**🛡️ 集群通信的安全加固**

创建集群专用zone：
```bash
# 创建数据库集群专用zone
sudo firewall-cmd --permanent --new-zone=db-cluster-zone

# 只允许集群内部网段
sudo firewall-cmd --permanent --zone=db-cluster-zone --add-source=192.168.1.200/29

# 允许集群所需的端口
sudo firewall-cmd --permanent --zone=db-cluster-zone --add-port=3306/tcp
sudo firewall-cmd --permanent --zone=db-cluster-zone --add-port=33061/tcp
sudo firewall-cmd --permanent --zone=db-cluster-zone --add-port=6446/tcp

sudo firewall-cmd --reload
```

**🔍 集群通信监控：**
```bash
# 监控集群通信端口状态
sudo ss -tulpn | grep -E "(3306|33061|6446)"

# 查看集群节点之间的连接
sudo netstat -an | grep ESTABLISHED | grep -E "(3306|33061)"
```

---

## 8. ⚖️ 读写分离网络配置


### 8.1 读写分离架构理解


**🔸 什么是读写分离**
```
读写分离就像是"专业分工"：
- 主数据库：专门处理写操作（INSERT、UPDATE、DELETE）
- 从数据库：专门处理读操作（SELECT）
- 应用程序：根据操作类型连接不同的数据库

网络架构示例：
应用服务器 → 写请求 → 主数据库 (192.168.1.200:3306)
应用服务器 → 读请求 → 从数据库 (192.168.1.201:3306)
             → 读请求 → 从数据库 (192.168.1.202:3306)
```

### 8.2 读写分离的防火墙策略


**📱 应用服务器的差异化访问**

为写操作配置主数据库访问：
```bash
# 主数据库(192.168.1.200)配置
# 只允许应用服务器的写操作
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="3306" protocol="tcp" 
  accept'

# 如果有多个应用服务器
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.101" 
  port port="3306" protocol="tcp" 
  accept'
```

为读操作配置从数据库访问：
```bash
# 从数据库1(192.168.1.201)配置
# 允许应用服务器和报表服务器的读操作
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="3306" protocol="tcp" 
  accept'

# 报表服务器只能读取数据
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.105" 
  port port="3306" protocol="tcp" 
  accept'
```

### 8.3 基于端口的读写分离


**🔌 使用不同端口区分读写操作**

有些读写分离方案使用不同端口：
```bash
# 主数据库：3306端口（写操作）
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="3306" protocol="tcp" 
  accept'

# 从数据库：3307端口（读操作）
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="3307" protocol="tcp" 
  accept'

# 报表专用端口：3308
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.105" 
  port port="3308" protocol="tcp" 
  accept'
```

### 8.4 读写分离中间件的网络配置


**🔄 MySQL Proxy/Router的防火墙设置**

MySQL Router作为读写分离中间件：
```bash
# 在MySQL Router服务器(192.168.1.210)上配置

# 允许应用服务器连接Router
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="6446" protocol="tcp" 
  accept'

# Router的管理端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="8443" protocol="tcp" 
  accept'
```

**在数据库服务器上允许Router访问：**
```bash
# 主数据库允许Router连接
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.210" 
  port port="3306" protocol="tcp" 
  accept'

# 从数据库允许Router连接
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.210" 
  port port="3306" protocol="tcp" 
  accept'
```

### 8.5 读写分离的负载均衡


**⚖️ 多个读库的负载均衡配置**

如果有多个读库需要负载均衡：
```bash
# 为每个读库配置相同的防火墙规则
# 读库1 (192.168.1.201)
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.210" 
  port port="3306" protocol="tcp" 
  accept'

# 读库2 (192.168.1.202)  
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.210" 
  port port="3306" protocol="tcp" 
  accept'

# 读库3 (192.168.1.203)
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.210" 
  port port="3306" protocol="tcp" 
  accept'
```

**📊 读写分离监控配置：**
```bash
# 监控服务器需要能够连接所有数据库节点
# 监控服务器 (192.168.3.100)

# 监控主库
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="3306" protocol="tcp" 
  accept'

# 监控所有读库
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.3.100" 
  port port="3306" protocol="tcp" 
  accept'
```

---

## 9. 🔐 数据传输加密配置


### 9.1 数据库SSL/TLS加密基础


**🔸 为什么需要数据传输加密**
```
数据传输加密就像是"保密信件"：
- 普通连接：数据明文传输，可能被窃听
- 加密连接：数据加密传输，即使被截获也无法解读
- 特别是涉及敏感数据时，加密传输是必须的

数据库加密传输的好处：
✅ 防止数据在网络传输中被窃取
✅ 确保连接到正确的数据库服务器
✅ 符合安全合规要求
✅ 保护用户名和密码不被泄露
```

### 9.2 MySQL SSL连接防火墙配置


**🔒 支持MySQL SSL连接的防火墙设置**

MySQL SSL连接使用相同的3306端口，但需要额外的配置：
```bash
# 允许SSL连接（端口相同，但连接方式不同）
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="3306" protocol="tcp" 
  accept'

# 检查SSL连接状态
# 在客户端使用：mysql -h server -u user -p --ssl-mode=REQUIRED
```

**📋 SSL连接验证方法：**
```bash
# 在MySQL客户端检查SSL状态
mysql> SHOW STATUS LIKE 'Ssl_cipher';
mysql> SHOW VARIABLES LIKE '%ssl%';

# 在服务器端检查SSL连接
mysql> SELECT * FROM performance_schema.session_status 
       WHERE VARIABLE_NAME = 'Ssl_cipher';
```

### 9.3 PostgreSQL SSL连接配置


**🐘 PostgreSQL加密连接的防火墙支持**

PostgreSQL也使用相同端口进行SSL连接：
```bash
# PostgreSQL SSL连接使用5432端口
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="5432" protocol="tcp" 
  accept'

# 客户端连接时指定SSL模式
# psql "host=server user=username dbname=mydb sslmode=require"
```

### 9.4 VPN隧道数据库访问


**🚇 通过VPN访问数据库的防火墙配置**

使用VPN可以为数据库连接提供额外的安全层：
```bash
# 只允许VPN网段访问数据库
# 假设VPN分配的IP段是10.8.0.0/24
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="10.8.0.0/24" 
  port port="3306" protocol="tcp" 
  accept'

# 移除直接的网络访问
sudo firewall-cmd --permanent --remove-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="3306" protocol="tcp" 
  accept'
```

**🔧 OpenVPN服务器的防火墙配置：**
```bash
# 在VPN服务器上开放VPN端口
sudo firewall-cmd --permanent --add-port=1194/udp

# 允许VPN客户端之间的通信
sudo firewall-cmd --permanent --add-masquerade

# 允许VPN流量转发到数据库网段
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="10.8.0.0/24" 
  destination address="192.168.1.0/24" 
  accept'
```

### 9.5 SSH隧道数据库访问


**🚇 使用SSH隧道访问数据库**

SSH隧道提供了另一种安全的数据库访问方式：
```bash
# 在数据库服务器上只允许SSH连接
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="22" protocol="tcp" 
  accept'

# 数据库端口只允许本地连接
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="127.0.0.1" 
  port port="3306" protocol="tcp" 
  accept'
```

**客户端建立SSH隧道：**
```bash
# 在客户端建立SSH隧道
ssh -L 3306:localhost:3306 user@database-server

# 然后连接本地端口即可访问远程数据库
mysql -h 127.0.0.1 -P 3306 -u username -p
```

### 9.6 数据库代理的加密配置


**🔄 数据库代理服务器的加密支持**

使用ProxySQL等代理服务器时的加密配置：
```bash
# ProxySQL服务器的防火墙配置
# 允许应用服务器连接ProxySQL
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.100" 
  port port="6033" protocol="tcp" 
  accept'

# ProxySQL管理端口（使用SSL）
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.0/24" 
  port port="6032" protocol="tcp" 
  accept'

# ProxySQL到后端数据库的连接
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4" 
  source address="192.168.1.220" 
  port port="3306" protocol="tcp" 
  accept'
```

---

## 10. 🎯 实战场景演练


### 10.1 电商网站数据库防护方案


**🛒 场景描述**
```
电商网站架构：
- Web服务器：192.168.1.10-15 (5台)
- 应用服务器：192.168.1.20-25 (6台)  
- 数据库主服务器：192.168.1.200
- 数据库从服务器：192.168.1.201-202 (2台)
- 缓存服务器：192.168.1.210 (Redis)
- 监控服务器：192.168.3.100
- 备份服务器：192.168.2.100
```

**完整防火墙配置方案：**
```bash
#!/bin/bash
# 电商网站数据库防火墙配置脚本

# 1. 主数据库防火墙配置
echo "配置主数据库防火墙..."

# 允许应用服务器访问主数据库（写操作）
for i in {20..25}; do
  sudo firewall-cmd --permanent --add-rich-rule="
    rule family='ipv4' 
    source address='192.168.1.$i' 
    port port='3306' protocol='tcp' 
    accept"
done

# 允许从数据库连接主数据库（数据同步）
sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  source address='192.168.1.201' 
  port port='3306' protocol='tcp' 
  accept"

sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  source address='192.168.1.202' 
  port port='3306' protocol='tcp' 
  accept"

# 2. 从数据库防火墙配置
echo "配置从数据库防火墙..."

# 允许应用服务器访问从数据库（读操作）
for i in {20..25}; do
  sudo firewall-cmd --permanent --add-rich-rule="
    rule family='ipv4' 
    source address='192.168.1.$i' 
    port port='3306' protocol='tcp' 
    accept"
done

# 3. 缓存服务器防火墙配置
echo "配置Redis缓存服务器防火墙..."

# 允许应用服务器访问Redis
for i in {20..25}; do
  sudo firewall-cmd --permanent --add-rich-rule="
    rule family='ipv4' 
    source address='192.168.1.$i' 
    port port='6379' protocol='tcp' 
    accept"
done

# 4. 监控和备份配置
echo "配置监控和备份访问..."

# 监控服务器访问权限
sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  source address='192.168.3.100' 
  port port='3306' protocol='tcp' 
  accept"

# 备份服务器访问权限（仅在备份时间窗口）
sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  source address='192.168.2.100' 
  port port='3306' protocol='tcp' 
  time start='02:00' stop='04:00'
  accept"

# 重新加载配置
sudo firewall-cmd --reload
echo "电商网站数据库防火墙配置完成！"
```

### 10.2 企业OA系统数据库安全


**🏢 企业OA系统场景**
```
企业办公架构：
- OA应用服务器：192.168.10.100
- 数据库服务器：192.168.10.200  
- 文件服务器：192.168.10.210
- 办公网段：192.168.10.0/24
- 管理员网段：192.168.20.0/24
- VPN网段：10.8.0.0/24
```

**企业级安全配置：**
```bash
#!/bin/bash
# 企业OA系统数据库安全配置

# 创建企业专用zone
sudo firewall-cmd --permanent --new-zone=enterprise-zone
sudo firewall-cmd --permanent --new-zone=admin-zone
sudo firewall-cmd --permanent --new-zone=vpn-zone

# 配置办公网段
sudo firewall-cmd --permanent --zone=enterprise-zone --add-source=192.168.10.0/24
sudo firewall-cmd --permanent --zone=enterprise-zone --add-port=3306/tcp

# 配置管理员网段
sudo firewall-cmd --permanent --zone=admin-zone --add-source=192.168.20.0/24
sudo firewall-cmd --permanent --zone=admin-zone --add-port=3306/tcp
sudo firewall-cmd --permanent --zone=admin-zone --add-port=22/tcp

# 配置VPN访问
sudo firewall-cmd --permanent --zone=vpn-zone --add-source=10.8.0.0/24
sudo firewall-cmd --permanent --zone=vpn-zone --add-port=3306/tcp

# 限制VPN用户的访问时间（只能在工作时间访问）
sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  source address='10.8.0.0/24' 
  port port='3306' protocol='tcp' 
  time start='08:00' stop='18:00' weekday='mon,tue,wed,thu,fri'
  accept"

# 重新加载配置
sudo firewall-cmd --reload
```

### 10.3 互联网金融数据库安全


**💰 金融系统高安全要求**
```bash
#!/bin/bash
# 金融系统数据库安全配置（最高安全级别）

# 1. 创建高安全zone
sudo firewall-cmd --permanent --new-zone=financial-zone
sudo firewall-cmd --permanent --zone=financial-zone --set-target=DROP

# 2. 只允许指定的应用服务器IP
sudo firewall-cmd --permanent --zone=financial-zone --add-source=192.168.100.10
sudo firewall-cmd --permanent --zone=financial-zone --add-source=192.168.100.11

# 3. 只在营业时间开放数据库访问
sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  source address='192.168.100.10' 
  port port='3306' protocol='tcp' 
  time start='09:00' stop='17:00' weekday='mon,tue,wed,thu,fri'
  accept"

# 4. 启用连接频率限制
sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  source address='192.168.100.10' 
  port port='3306' protocol='tcp' 
  limit value='100/m' 
  accept"

# 5. 管理员只能通过跳板机访问
sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  source address='192.168.100.5' 
  port port='22' protocol='tcp' 
  accept"

# 6. 启用日志记录
sudo firewall-cmd --permanent --add-rich-rule="
  rule family='ipv4' 
  port port='3306' protocol='tcp' 
  log prefix='DB-ACCESS: ' level='info' 
  drop"

sudo firewall-cmd --reload
```

### 10.4 故障排查实战


**🔧 常见问题诊断和解决**

**问题1：应用无法连接数据库**
```bash
# 诊断步骤
echo "=== 数据库连接故障诊断 ==="

# 1. 检查防火墙状态
echo "1. 检查防火墙状态:"
sudo firewall-cmd --state

# 2. 检查当前规则
echo "2. 检查防火墙规则:"
sudo firewall-cmd --list-all

# 3. 检查数据库端口是否监听
echo "3. 检查数据库端口:"
sudo ss -tulpn | grep :3306

# 4. 从应用服务器测试连接
echo "4. 测试网络连接:"
telnet 192.168.1.200 3306

# 5. 检查防火墙日志
echo "5. 检查防火墙日志:"
sudo journalctl -u firewalld | tail -20
```

**问题2：性能突然下降**
```bash
# 性能问题诊断
echo "=== 数据库性能问题诊断 ==="

# 1. 检查连接数
echo "1. 当前数据库连接数:"
sudo ss -an | grep :3306 | grep ESTABLISHED | wc -l

# 2. 检查是否有大量连接被阻止
echo "2. 检查防火墙阻止的连接:"
sudo journalctl -u firewalld | grep DROP | tail -10

# 3. 检查连接限制规则
echo "3. 检查连接限制规则:"
sudo firewall-cmd --list-rich-rules | grep limit

# 4. 临时移除限制测试
echo "4. 临时移除连接限制进行测试:"
# (具体的移除命令根据实际规则而定)
```

---

## 11. 📋 核心要点总结


### 11.1 必须掌握的基本概念


```
🔸 数据库防火墙保护本质：网络层面的访问控制，是数据库安全的第一道防线
🔸 白名单机制：只允许明确授权的IP和端口访问，默认拒绝所有
🔸 端口分类管理：业务端口、管理端口、监控端口需要不同的安全策略
🔸 网络隔离原则：数据库应该在内网，不直接暴露到公网
🔸 最小权限原则：只开放必要的端口和IP，及时关闭不需要的访问
```

### 11.2 关键理解要点


**🔹 数据库防火墙策略的层次性**
```
网络层隔离：
- 使用防火墙zone将不同类型的服务器分组
- 业务服务器、管理服务器、监控服务器分别配置

端口级控制：
- 主数据库端口：严格限制写权限
- 从数据库端口：相对宽松的读权限
- 管理端口：最严格的访问控制

时间维度控制：
- 备份访问：仅在备份时间窗口开放
- 管理访问：仅在工作时间允许
- 紧急维护：临时规则快速响应
```

**🔹 不同场景的安全要求差异**
```
电商网站：
- 重点保护用户数据和交易数据
- 需要支持高并发访问
- 读写分离减轻主库压力

企业内网：
- 重点是内部权限控制
- 需要支持VPN远程访问
- 工作时间限制比较重要

金融系统：
- 最高级别的安全要求
- 严格的访问审计
- 多层防护机制
```

### 11.3 实际应用指导原则


**💡 防火墙规则设计最佳实践**
```
规则制定原则：
✅ 先拒绝所有，再逐个开放需要的访问
✅ 定期检查和清理不需要的规则
✅ 为不同环境创建不同的安全策略
✅ 保持规则的文档化和版本控制

配置管理建议：
✅ 使用脚本自动化防火墙配置
✅ 测试环境先验证规则有效性
✅ 建立规则变更的审批流程
✅ 定期备份防火墙配置

监控和维护：
✅ 设置防火墙日志监控告警
✅ 定期分析访问日志发现异常
✅ 建立紧急情况的快速响应机制
✅ 培训团队成员掌握基本操作
```

### 11.4 常见错误避免


**❌ 典型的配置错误**
```
过于宽松的规则：
- 开放0.0.0.0/0访问数据库端口
- 使用默认的firewall zone配置
- 没有定期清理临时规则

过于严格的规则：
- 阻止了正常的业务连接
- 没有考虑集群内部通信需求
- 忘记为监控和备份开放端口

管理维护问题：
- 没有文档记录规则用途
- 缺少规则变更的测试验证
- 应急处理时的操作失误
```

### 11.5 安全合规要求


**📋 行业安全标准对照**
```
金融行业标准：
- 数据库不能直接暴露在公网
- 所有访问必须有审计日志
- 定期进行安全漏洞扫描

医疗行业标准：
- 患者数据访问严格控制
- 需要支持数据加密传输
- 访问记录保存要求

一般企业标准：
- 实施最小权限原则
- 定期更新安全策略
- 建立应急响应机制
```

### 11.6 故障处理快速指南


**🚨 紧急情况处理步骤**
```
应用无法连接数据库：
1. 检查防火墙服务状态
2. 验证防火墙规则配置
3. 测试网络连通性
4. 查看防火墙日志
5. 必要时临时放宽规则

性能突然下降：
1. 检查连接数是否达到限制
2. 查看是否有大量连接被拒绝
3. 验证连接限制规则设置
4. 临时调整限制进行测试

误操作导致服务中断：
1. 立即查看当前防火墙规则
2. 从备份恢复正确配置
3. 验证服务恢复正常
4. 分析问题原因并改进流程
```

### 11.7 学习进阶建议


**📚 深入学习路线**
```
基础巩固：
- 熟练掌握firewall-cmd基本命令
- 理解zone和rich-rule的使用场景
- 练习不同数据库的端口配置

进阶提升：
- 学习iptables底层原理
- 掌握网络安全监控工具
- 了解入侵检测系统配置

专业发展：
- 获得相关安全认证
- 参与安全社区讨论
- 关注最新的安全威胁和防护方法
```

**核心记忆口诀**：
```
数据库防火墙配置要点：
- 白名单策略严把关，默认拒绝保安全
- 端口分类细管理，业务管理要分离  
- 时间维度加控制，备份监控有窗期
- 集群通信需特殊，加密传输更安全
- 文档脚本要齐全，应急处理有预案
```

**🎯 最终建议**
数据库防火墙保护是一个系统工程，需要根据实际业务需求制定合适的安全策略。记住安全和便利性往往是平衡的艺术，过度严格可能影响业务正常运行，过于宽松则存在安全风险。最重要的是建立完善的管理流程，确保安全策略能够持续有效地执行。