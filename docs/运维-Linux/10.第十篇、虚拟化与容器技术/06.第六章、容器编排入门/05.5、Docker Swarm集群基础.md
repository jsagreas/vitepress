---
title: 5ã€Docker Swarmé›†ç¾¤åŸºç¡€
---
## ğŸ“š ç›®å½•

1. [Docker Swarmé›†ç¾¤æ¦‚å¿µ](#1-docker-swarmé›†ç¾¤æ¦‚å¿µ)
2. [é›†ç¾¤èŠ‚ç‚¹è§’è‰²è¯¦è§£](#2-é›†ç¾¤èŠ‚ç‚¹è§’è‰²è¯¦è§£)
3. [é›†ç¾¤åˆå§‹åŒ–ä¸èŠ‚ç‚¹ç®¡ç†](#3-é›†ç¾¤åˆå§‹åŒ–ä¸èŠ‚ç‚¹ç®¡ç†)
4. [é›†ç¾¤ç½‘ç»œé…ç½®](#4-é›†ç¾¤ç½‘ç»œé…ç½®)
5. [å®‰å…¨æœºåˆ¶ä¸ä»¤ç‰Œç®¡ç†](#5-å®‰å…¨æœºåˆ¶ä¸ä»¤ç‰Œç®¡ç†)
6. [é«˜å¯ç”¨é›†ç¾¤é…ç½®](#6-é«˜å¯ç”¨é›†ç¾¤é…ç½®)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ³ Docker Swarmé›†ç¾¤æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Docker Swarm


ğŸ”¥ **å¿…é¡»æŒæ¡** - **Docker Swarm**æ˜¯Dockerå®˜æ–¹æä¾›çš„**åŸç”Ÿé›†ç¾¤ç®¡ç†å·¥å…·**ï¼Œè®©ä½ èƒ½æŠŠå¤šå°Dockerä¸»æœºç»„æˆä¸€ä¸ª**è™šæ‹Ÿçš„Dockerä¸»æœº**ã€‚

**ğŸ§  è®°å¿†å£è¯€**ï¼š`Swarm = èœ‚ç¾¤ï¼Œå¤šä¸ªDockerä¸»æœºåƒèœœèœ‚ä¸€æ ·ååŒå·¥ä½œ`

```
ä¼ ç»Ÿå•æœºDockerï¼š        Docker Swarmé›†ç¾¤ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æœºA     â”‚          â”‚  Manager    â”‚  â”‚   Worker    â”‚  â”‚   Worker    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Containerâ”‚ â”‚    â†’     â”‚ â”‚Containerâ”‚ â”‚  â”‚ â”‚Containerâ”‚ â”‚  â”‚ â”‚Containerâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ç‹¬ç«‹å·¥ä½œ                     ååŒå·¥ä½œï¼Œç»Ÿä¸€ç®¡ç†
```

### 1.2 Swarmè§£å†³çš„æ ¸å¿ƒé—®é¢˜


â­â­â­ **æ ¸å¿ƒä»·å€¼**ï¼š

**ğŸ¯ å®¹å™¨è°ƒåº¦é—®é¢˜**
- **é—®é¢˜**ï¼šæœ‰10ä¸ªå®¹å™¨è¦è¿è¡Œï¼Œ3å°æœåŠ¡å™¨ï¼Œæ€ä¹ˆåˆ†é…ï¼Ÿ
- **è§£å†³**ï¼šSwarmè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„èŠ‚ç‚¹è¿è¡Œå®¹å™¨

**ğŸ¯ æœåŠ¡å‘ç°é—®é¢˜**  
- **é—®é¢˜**ï¼šå®¹å™¨åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œæ€ä¹ˆäº’ç›¸æ‰¾åˆ°ï¼Ÿ
- **è§£å†³**ï¼šSwarmæä¾›å†…ç½®çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡

**ğŸ¯ æ•…éšœæ¢å¤é—®é¢˜**
- **é—®é¢˜**ï¼šæŸå°æœåŠ¡å™¨æŒ‚äº†ï¼Œä¸Šé¢çš„å®¹å™¨æ€ä¹ˆåŠï¼Ÿ
- **è§£å†³**ï¼šSwarmè‡ªåŠ¨åœ¨å¥åº·èŠ‚ç‚¹é‡å¯å®¹å™¨

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šSwarmå°±åƒä¸€ä¸ªæ™ºèƒ½çš„é¡¹ç›®ç»ç†ï¼Œä½ å‘Šè¯‰ä»–"æˆ‘éœ€è¦è¿è¡Œ3ä¸ªWebæœåŠ¡"ï¼Œä»–ä¼šè‡ªåŠ¨å®‰æ’ç»™åˆé€‚çš„å‘˜å·¥ï¼ˆæœåŠ¡å™¨ï¼‰ï¼Œå¦‚æœæŸä¸ªå‘˜å·¥ç”Ÿç—…äº†ï¼Œä¼šç«‹å³å®‰æ’å…¶ä»–å‘˜å·¥æ¥æ‰‹ã€‚

### 1.3 Swarm vs å…¶ä»–å®¹å™¨ç¼–æ’å·¥å…·


| ç‰¹æ€§ | **Docker Swarm** | **Kubernetes** | **Docker Compose** |
|------|------------------|----------------|-------------------|
| ğŸ”§ **å­¦ä¹ éš¾åº¦** | `â­â­â˜†â˜†â˜† ç®€å•` | `â­â­â­â­â­ å¤æ‚` | `â­â­â˜†â˜†â˜† ç®€å•` |
| ğŸš€ **åŠŸèƒ½ä¸°å¯Œåº¦** | `â­â­â­â˜†â˜† ä¸­ç­‰` | `â­â­â­â­â­ å¼ºå¤§` | `â­â­â˜†â˜†â˜† åŸºç¡€` |
| ğŸ“Š **é›†ç¾¤è§„æ¨¡** | `ä¸­å°å‹é›†ç¾¤` | `å¤§å‹é›†ç¾¤` | `å•æœºå¼€å‘` |
| ğŸ¯ **é€‚ç”¨åœºæ™¯** | `å¿«é€Ÿéƒ¨ç½²ï¼Œç®€å•è¿ç»´` | `å¤æ‚å¾®æœåŠ¡ï¼Œå¤§è§„æ¨¡` | `æœ¬åœ°å¼€å‘æµ‹è¯•` |

---

## 2. ğŸ‘¥ é›†ç¾¤èŠ‚ç‚¹è§’è‰²è¯¦è§£


### 2.1 ManagerèŠ‚ç‚¹ï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰


ğŸ”´ **é«˜çº§** - ManagerèŠ‚ç‚¹æ˜¯é›†ç¾¤çš„**å¤§è„‘**ï¼Œè´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„ç®¡ç†å’Œè°ƒåº¦ã€‚

**ğŸ“‹ ManagerèŠ‚ç‚¹èŒè´£**ï¼š
```
é›†ç¾¤ç®¡ç†ä»»åŠ¡ï¼š
â”œâ”€â”€ ğŸ§  è°ƒåº¦å†³ç­–ï¼šå†³å®šå®¹å™¨åœ¨å“ªä¸ªèŠ‚ç‚¹è¿è¡Œ
â”œâ”€â”€ ğŸ›ï¸ çŠ¶æ€ç»´æŠ¤ï¼šä¿å­˜é›†ç¾¤çŠ¶æ€ä¿¡æ¯
â”œâ”€â”€ ğŸ“¡ APIæœåŠ¡ï¼šå¯¹å¤–æä¾›Docker APIæ¥å£
â”œâ”€â”€ âš–ï¸ è´Ÿè½½å‡è¡¡ï¼šç®¡ç†æœåŠ¡çš„è´Ÿè½½åˆ†å‘
â””â”€â”€ ğŸ” å®‰å…¨ç®¡ç†ï¼šç®¡ç†é›†ç¾¤å®‰å…¨ç­–ç•¥

æŠ€æœ¯å®ç°ï¼š
â€¢ åŸºäºRaftç®—æ³•ä¿è¯ä¸€è‡´æ€§
â€¢ å¯ä»¥åŒæ—¶ä½œä¸ºWorkerè¿è¡Œå®¹å™¨
â€¢ é»˜è®¤æƒ…å†µä¸‹ä¹Ÿä¼šè¿è¡Œä»»åŠ¡è´Ÿè½½
```

> âš ï¸ **é‡è¦æé†’**ï¼šManagerèŠ‚ç‚¹æ•°é‡å¿…é¡»æ˜¯**å¥‡æ•°**ï¼ˆ1,3,5,7ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºRaftç®—æ³•éœ€è¦è¿‡åŠæ•°åŒæ„æ‰èƒ½åšå†³ç­–ã€‚

**ğŸ”¢ ManagerèŠ‚ç‚¹æ•°é‡è§„åˆ’**ï¼š

| é›†ç¾¤è§„æ¨¡ | æ¨èManageræ•°é‡ | å®¹é”™èƒ½åŠ› | è¯´æ˜ |
|----------|-----------------|----------|------|
| `1-3å°` | **1ä¸ª** | `0å°æ•…éšœ` | é€‚åˆå¼€å‘æµ‹è¯• |
| `3-7å°` | **3ä¸ª** | `1å°æ•…éšœ` | é€‚åˆå°å‹ç”Ÿäº§ |
| `8-15å°` | **5ä¸ª** | `2å°æ•…éšœ` | é€‚åˆä¸­å‹ç”Ÿäº§ |
| `15+å°` | **7ä¸ª** | `3å°æ•…éšœ` | å¤§å‹ç”Ÿäº§ç¯å¢ƒ |

### 2.2 WorkerèŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰


ğŸŸ¢ **åŸºç¡€æ¦‚å¿µ** - WorkerèŠ‚ç‚¹æ˜¯é›†ç¾¤çš„**åŠ³åŠ¨åŠ›**ï¼Œä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ä»»åŠ¡ã€‚

**ğŸ“‹ WorkerèŠ‚ç‚¹ç‰¹ç‚¹**ï¼š
```
ä¸»è¦èŒè´£ï¼š
â”œâ”€â”€ ğŸƒ è¿è¡Œå®¹å™¨ï¼šæ‰§è¡ŒManageråˆ†é…çš„ä»»åŠ¡
â”œâ”€â”€ ğŸ“Š çŠ¶æ€æŠ¥å‘Šï¼šå‘Manageræ±‡æŠ¥èŠ‚ç‚¹çŠ¶æ€
â”œâ”€â”€ ğŸ”„ æ¥æ”¶æŒ‡ä»¤ï¼šæ¥æ”¶å¹¶æ‰§è¡Œç®¡ç†å‘½ä»¤
â””â”€â”€ ğŸŒ ç½‘ç»œé€šä¿¡ï¼šå‚ä¸é›†ç¾¤ç½‘ç»œé€šä¿¡

è¿è¡Œæ¨¡å¼ï¼š
â€¢ åªè¿è¡Œä»»åŠ¡ï¼Œä¸å‚ä¸ç®¡ç†å†³ç­–
â€¢ å¯ä»¥åŠ¨æ€åŠ å…¥å’Œç¦»å¼€é›†ç¾¤
â€¢ å¯ä»¥è¢«æå‡ä¸ºManagerèŠ‚ç‚¹
```

**ğŸ¯ èŠ‚ç‚¹è§’è‰²è½¬æ¢**ï¼š
```
Worker â†’ Managerï¼š  docker node promote <node-name>
Manager â†’ Workerï¼š  docker node demote <node-name>
```

### 2.3 èŠ‚ç‚¹çŠ¶æ€ç®¡ç†


**ğŸ“Š èŠ‚ç‚¹å¯ç”¨æ€§çŠ¶æ€**ï¼š

| çŠ¶æ€ | å«ä¹‰ | **Managerè¡Œä¸º** | **Workerè¡Œä¸º** |
|------|------|-----------------|----------------|
| `Active` | æ­£å¸¸å·¥ä½œ | `å¯è°ƒåº¦ä»»åŠ¡ï¼Œå‚ä¸å†³ç­–` | `å¯è¿è¡Œä»»åŠ¡` |
| `Pause` | æš‚åœçŠ¶æ€ | `ä¸è°ƒåº¦æ–°ä»»åŠ¡ï¼Œå‚ä¸å†³ç­–` | `ä¸æ¥æ”¶æ–°ä»»åŠ¡` |
| `Drain` | æ’ç©ºçŠ¶æ€ | `è¿ç§»ç°æœ‰ä»»åŠ¡ï¼Œå‚ä¸å†³ç­–` | `è¿ç§»ç°æœ‰ä»»åŠ¡` |

---

## 3. ğŸš€ é›†ç¾¤åˆå§‹åŒ–ä¸èŠ‚ç‚¹ç®¡ç†


### 3.1 åˆå§‹åŒ–Swarmé›†ç¾¤


â­ **å…¥é—¨çº§** - ä½¿ç”¨`docker swarm init`å‘½ä»¤åˆ›å»ºé›†ç¾¤ã€‚

**ğŸ”§ åŸºç¡€åˆå§‹åŒ–**ï¼š
```bash
# åœ¨ç¬¬ä¸€å°æœºå™¨ä¸Šåˆå§‹åŒ–é›†ç¾¤ï¼ˆè‡ªåŠ¨æˆä¸ºManagerï¼‰
docker swarm init

# æŒ‡å®šç›‘å¬åœ°å€ï¼ˆæ¨èæ–¹å¼ï¼‰
docker swarm init --advertise-addr 192.168.1.100
```

**ğŸ’¡ å‚æ•°è¯´æ˜**ï¼š
- `--advertise-addr`ï¼š**é‡è¦**ï¼æŒ‡å®šå½“å‰èŠ‚ç‚¹çš„IPåœ°å€ï¼Œå…¶ä»–èŠ‚ç‚¹é€šè¿‡è¿™ä¸ªåœ°å€è¿æ¥

**ğŸ¯ åˆå§‹åŒ–æˆåŠŸåçš„è¾“å‡º**ï¼š
```bash
Swarm initialized: current node (abc123...) is now a manager.

To add a worker node to this swarm, run the following command:
    docker swarm join --token SWMTKN-1-xxxxx \
    192.168.1.100:2377

To add a manager node to this swarm, run 'docker swarm join-token manager'
```

> ğŸ“ **å°è´´å£«**ï¼šåˆå§‹åŒ–åä¼šè‡ªåŠ¨ç”Ÿæˆä¸¤ç§ä»¤ç‰Œï¼Œworkerä»¤ç‰Œå’Œmanagerä»¤ç‰Œï¼Œè¦ä¿å­˜å¥½ï¼

### 3.2 èŠ‚ç‚¹åŠ å…¥é›†ç¾¤


**ğŸ”— WorkerèŠ‚ç‚¹åŠ å…¥**ï¼š
```bash
# åœ¨å…¶ä»–æœºå™¨ä¸Šæ‰§è¡Œï¼ˆä½¿ç”¨åˆå§‹åŒ–æ—¶ç»™å‡ºçš„å‘½ä»¤ï¼‰
docker swarm join --token SWMTKN-1-worker-token \
    192.168.1.100:2377
```

**ğŸ”— ManagerèŠ‚ç‚¹åŠ å…¥**ï¼š
```bash
# å…ˆè·å–managerä»¤ç‰Œ
docker swarm join-token manager

# åœ¨å…¶ä»–æœºå™¨ä¸Šæ‰§è¡Œ
docker swarm join --token SWMTKN-1-manager-token \
    192.168.1.100:2377
```

### 3.3 èŠ‚ç‚¹çŠ¶æ€æŸ¥çœ‹ä¸ç®¡ç†


**ğŸ“Š æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
docker node ls

# è¾“å‡ºç¤ºä¾‹ï¼š
ID              HOSTNAME    STATUS    AVAILABILITY    MANAGER STATUS
abc123...  *    manager1    Ready     Active          Leader
def456...       worker1     Ready     Active
ghi789...       worker2     Ready     Active
```

**ğŸ›ï¸ èŠ‚ç‚¹ç®¡ç†å‘½ä»¤**ï¼š

| å‘½ä»¤ | ä½œç”¨ | **ä½¿ç”¨åœºæ™¯** |
|------|------|--------------|
| `docker node inspect <node>` | æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ… | `æ•…éšœè¯Šæ–­` |
| `docker node update --availability drain <node>` | æ’ç©ºèŠ‚ç‚¹ | `ç»´æŠ¤å‡çº§` |
| `docker node update --availability active <node>` | æ¿€æ´»èŠ‚ç‚¹ | `æ¢å¤æœåŠ¡` |
| `docker node rm <node>` | åˆ é™¤èŠ‚ç‚¹ | `ç¼©å®¹é›†ç¾¤` |

**ğŸ› ï¸ å®ç”¨æ“ä½œç¤ºä¾‹**ï¼š
```bash
# ç»´æŠ¤worker1èŠ‚ç‚¹å‰ï¼Œå…ˆæ’ç©ºä»»åŠ¡
docker node update --availability drain worker1

# ç»´æŠ¤å®Œæˆåï¼Œé‡æ–°æ¿€æ´»
docker node update --availability active worker1

# å¼ºåˆ¶åˆ é™¤ç¦»çº¿èŠ‚ç‚¹
docker node rm --force worker2
```

### 3.4 é›†ç¾¤è§£æ•£ä¸ç¦»å¼€


**ğŸšª ç¦»å¼€é›†ç¾¤**ï¼š
```bash
# WorkerèŠ‚ç‚¹ç¦»å¼€
docker swarm leave

# ManagerèŠ‚ç‚¹å¼ºåˆ¶ç¦»å¼€
docker swarm leave --force
```

> âš ï¸ **è­¦å‘Š**ï¼šå¦‚æœæ˜¯æœ€åä¸€ä¸ªManagerèŠ‚ç‚¹ï¼Œå¿…é¡»ä½¿ç”¨`--force`å‚æ•°ï¼Œè¿™ä¼šè§£æ•£æ•´ä¸ªé›†ç¾¤ï¼

---

## 4. ğŸŒ é›†ç¾¤ç½‘ç»œé…ç½®


### 4.1 Overlayç½‘ç»œåŸç†


ğŸŸ¡ **è¿›é˜¶çº§** - **Overlayç½‘ç»œ**æ˜¯Swarmé›†ç¾¤ä¸­å®¹å™¨è·¨ä¸»æœºé€šä¿¡çš„æ ¸å¿ƒæŠ€æœ¯ã€‚

**ğŸ§  è®°å¿†ç†è§£**ï¼š`Overlay = è¦†ç›–ç½‘ç»œï¼Œå°±åƒåœ¨ç‰©ç†ç½‘ç»œä¸Šç›–äº†ä¸€å±‚è™šæ‹Ÿç½‘ç»œ`

```
ç‰©ç†ç½‘ç»œæ‹“æ‰‘ï¼š              Overlayç½‘ç»œæ‹“æ‰‘ï¼š
                           
ä¸»æœºA(192.168.1.100)       å®¹å™¨ç½‘ç»œ(10.0.0.0/24)
â”œâ”€â”€ å®¹å™¨1                  â”œâ”€â”€ å®¹å™¨1(10.0.0.2)
â””â”€â”€ å®¹å™¨2                  â”œâ”€â”€ å®¹å™¨2(10.0.0.3)
                           â”œâ”€â”€ å®¹å™¨3(10.0.0.4) â† åœ¨ä¸»æœºBä¸Š
ä¸»æœºB(192.168.1.101)       â””â”€â”€ å®¹å™¨4(10.0.0.5) â† åœ¨ä¸»æœºBä¸Š
â”œâ”€â”€ å®¹å™¨3                  
â””â”€â”€ å®¹å™¨4                  å®¹å™¨é—´å¯ä»¥ç›´æ¥é€šè¿‡10.0.0.xé€šä¿¡
                           æ— éœ€å…³å¿ƒç‰©ç†ä¸»æœºIP
```

### 4.2 Overlayç½‘ç»œç±»å‹


**ğŸ“‹ Swarmç½‘ç»œåˆ†ç±»**ï¼š

| ç½‘ç»œç±»å‹ | **ä½œç”¨èŒƒå›´** | **é€‚ç”¨åœºæ™¯** | **åˆ›å»ºæ–¹å¼** |
|----------|--------------|--------------|--------------|
| `ingress` | é›†ç¾¤å†…ç½® | æœåŠ¡å‘å¸ƒ | `è‡ªåŠ¨åˆ›å»º` |
| `docker_gwbridge` | èŠ‚ç‚¹æœ¬åœ° | å®¹å™¨ä¸ä¸»æœºé€šä¿¡ | `è‡ªåŠ¨åˆ›å»º` |
| `è‡ªå®šä¹‰overlay` | è·¨ä¸»æœº | æœåŠ¡é—´é€šä¿¡ | `æ‰‹åŠ¨åˆ›å»º` |

### 4.3 åˆ›å»ºå’Œç®¡ç†Overlayç½‘ç»œ


**ğŸ”§ åˆ›å»ºè‡ªå®šä¹‰Overlayç½‘ç»œ**ï¼š
```bash
# åˆ›å»ºåŸºæœ¬overlayç½‘ç»œ
docker network create --driver overlay my-network

# åˆ›å»ºå¸¦åŠ å¯†çš„overlayç½‘ç»œï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
docker network create \
  --driver overlay \
  --opt encrypted \
  secure-network

# åˆ›å»ºå¯è¢«å¤–éƒ¨å®¹å™¨ä½¿ç”¨çš„ç½‘ç»œ
docker network create \
  --driver overlay \
  --attachable \
  app-network
```

**ğŸ“Š æŸ¥çœ‹ç½‘ç»œä¿¡æ¯**ï¼š
```bash
# åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ
docker network ls

# æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯
docker network inspect my-network
```

**ğŸ¯ ç½‘ç»œä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œçš„æœåŠ¡
docker service create \
  --name web \
  --network my-network \
  --replicas 3 \
  nginx

# åŒç½‘ç»œå†…çš„æœåŠ¡å¯ä»¥é€šè¿‡æœåŠ¡åäº’ç›¸è®¿é—®
docker service create \
  --name api \
  --network my-network \
  node:alpine
```

> ğŸ’¡ **å°è´´å£«**ï¼šåŒä¸€ä¸ªoverlayç½‘ç»œå†…çš„å®¹å™¨å¯ä»¥ç›´æ¥é€šè¿‡**æœåŠ¡å**è¿›è¡Œé€šä¿¡ï¼ŒSwarmä¼šè‡ªåŠ¨è¿›è¡ŒDNSè§£æå’Œè´Ÿè½½å‡è¡¡ã€‚

---

## 5. ğŸ” å®‰å…¨æœºåˆ¶ä¸ä»¤ç‰Œç®¡ç†


### 5.1 Swarmå®‰å…¨æ¶æ„


ğŸ”´ **é«˜çº§** - Swarmå†…ç½®äº†å®Œæ•´çš„å®‰å…¨æœºåˆ¶ï¼Œç¡®ä¿é›†ç¾¤é€šä¿¡å®‰å…¨ã€‚

**ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§**ï¼š
```
èº«ä»½è®¤è¯ï¼š
â”œâ”€â”€ ğŸ« TLSè¯ä¹¦ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å”¯ä¸€è¯ä¹¦
â”œâ”€â”€ ğŸ”‘ åŠ å¯†é€šä¿¡ï¼šæ‰€æœ‰é›†ç¾¤é€šä¿¡éƒ½åŠ å¯†
â”œâ”€â”€ ğŸ¯ ä»¤ç‰Œè®¤è¯ï¼šä½¿ç”¨ä»¤ç‰Œæ§åˆ¶èŠ‚ç‚¹åŠ å…¥
â””â”€â”€ ğŸ”„ è¯ä¹¦è½®æ¢ï¼šå®šæœŸè‡ªåŠ¨æ›´æ–°è¯ä¹¦

æƒé™æ§åˆ¶ï¼š
â”œâ”€â”€ ğŸ‘‘ Manageræƒé™ï¼šå®Œå…¨æ§åˆ¶é›†ç¾¤
â”œâ”€â”€ ğŸ‘· Workeræƒé™ï¼šåªèƒ½æ‰§è¡Œä»»åŠ¡
â””â”€â”€ ğŸ“Š RBACï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
```

### 5.2 ä»¤ç‰Œç®¡ç†è¯¦è§£


**ğŸ« ä»¤ç‰Œç±»å‹è¯´æ˜**ï¼š

| ä»¤ç‰Œç±»å‹ | **ç”¨é€”** | **æƒé™çº§åˆ«** | **è·å–æ–¹å¼** |
|----------|----------|--------------|--------------|
| `Workerä»¤ç‰Œ` | å·¥ä½œèŠ‚ç‚¹åŠ å…¥ | åªèƒ½è¿è¡Œä»»åŠ¡ | `docker swarm join-token worker` |
| `Managerä»¤ç‰Œ` | ç®¡ç†èŠ‚ç‚¹åŠ å…¥ | å®Œå…¨ç®¡ç†æƒé™ | `docker swarm join-token manager` |

**ğŸ”§ ä»¤ç‰Œç®¡ç†å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹workeråŠ å…¥ä»¤ç‰Œ
docker swarm join-token worker

# æŸ¥çœ‹manageråŠ å…¥ä»¤ç‰Œ
docker swarm join-token manager

# é‡æ–°ç”Ÿæˆworkerä»¤ç‰Œï¼ˆæ—§ä»¤ç‰Œå¤±æ•ˆï¼‰
docker swarm join-token --rotate worker

# é‡æ–°ç”Ÿæˆmanagerä»¤ç‰Œ
docker swarm join-token --rotate manager
```

**ğŸš¨ ä»¤ç‰Œå®‰å…¨æœ€ä½³å®è·µ**ï¼š

> âœ… **æ¨èåšæ³•**ï¼š
> - å®šæœŸè½®æ¢ä»¤ç‰Œï¼ˆå»ºè®®æ¯æœˆä¸€æ¬¡ï¼‰
> - ä¸è¦åœ¨è„šæœ¬æˆ–æ—¥å¿—ä¸­æ˜æ–‡ä¿å­˜ä»¤ç‰Œ
> - ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·å®‰å…¨ä¼ é€’ä»¤ç‰Œ

> ğŸš« **é¿å…åšæ³•**ï¼š
> - åœ¨å…¬å…±åœºæ‰€å±•ç¤ºå«æœ‰ä»¤ç‰Œçš„å‘½ä»¤
> - é•¿æœŸä½¿ç”¨åŒä¸€ä¸ªä»¤ç‰Œ
> - é€šè¿‡ä¸å®‰å…¨çš„æ–¹å¼ä¼ è¾“ä»¤ç‰Œ

### 5.3 è¯ä¹¦å’Œå¯†é’¥ç®¡ç†


**ğŸ” è¯ä¹¦ç®¡ç†**ï¼š
```bash
# æŸ¥çœ‹é›†ç¾¤è¯ä¹¦ä¿¡æ¯
docker system info | grep -A 5 "Swarm"

# æ‰‹åŠ¨è½®æ¢è¯ä¹¦ï¼ˆç´§æ€¥æƒ…å†µï¼‰
docker swarm ca --rotate

# æŸ¥çœ‹èŠ‚ç‚¹è¯ä¹¦æœ‰æ•ˆæœŸ
docker node inspect self --format '{{.Description.TLSInfo.TrustRoot}}'
```

**ğŸ“ˆ è¯ä¹¦è½®æ¢ç­–ç•¥**ï¼š
- **è‡ªåŠ¨è½®æ¢**ï¼šé»˜è®¤90å¤©è‡ªåŠ¨è½®æ¢ä¸€æ¬¡
- **æ‰‹åŠ¨è½®æ¢**ï¼šå®‰å…¨äº‹ä»¶å‘ç”Ÿæ—¶ç«‹å³è½®æ¢
- **æ¸è¿›è½®æ¢**ï¼šé›†ç¾¤ä¼šé€ä¸ªèŠ‚ç‚¹æ›´æ–°ï¼Œä¸å½±å“æœåŠ¡

---

## 6. ğŸ—ï¸ é«˜å¯ç”¨é›†ç¾¤é…ç½®


### 6.1 é«˜å¯ç”¨æ¶æ„è®¾è®¡


â­â­â­ **é‡ç‚¹ç†è§£** - é«˜å¯ç”¨æ˜¯ç”Ÿäº§ç¯å¢ƒé›†ç¾¤çš„**å¿…å¤‡ç‰¹æ€§**ã€‚

**ğŸ¯ é«˜å¯ç”¨åŸåˆ™**ï¼š
```
åˆ†å¸ƒå¼éƒ¨ç½²ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®ä¸­å¿ƒA  â”‚  â”‚   æ•°æ®ä¸­å¿ƒB  â”‚  â”‚   æ•°æ®ä¸­å¿ƒC  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Manager1 â”‚ â”‚  â”‚ â”‚Manager2 â”‚ â”‚  â”‚ â”‚Manager3 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Worker1  â”‚ â”‚  â”‚ â”‚Worker2  â”‚ â”‚  â”‚ â”‚Worker3  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¸å¿ƒè¦æ±‚ï¼š
â€¢ ManagerèŠ‚ç‚¹å¥‡æ•°ä¸ªï¼ˆ3,5,7ï¼‰
â€¢ è·¨æœºæˆ¿éƒ¨ç½²é¿å…å•ç‚¹æ•…éšœ
â€¢ ç½‘ç»œå»¶è¿Ÿ < 50ms
â€¢ è¶³å¤Ÿçš„èµ„æºå†—ä½™
```

### 6.2 Leaderé€‰ä¸¾æœºåˆ¶


**ğŸ—³ï¸ Raftç®—æ³•ç®€åŒ–ç†è§£**ï¼š
```
é€‰ä¸¾è¿‡ç¨‹ï¼š
1. åˆå§‹çŠ¶æ€ï¼šæ‰€æœ‰Manageréƒ½æ˜¯Follower
2. è¶…æ—¶è§¦å‘ï¼šæŸä¸ªèŠ‚ç‚¹å˜æˆCandidateå¼€å§‹é€‰ä¸¾
3. æŠ•ç¥¨è¿‡ç¨‹ï¼šè·å¾—è¶…è¿‡åŠæ•°æŠ•ç¥¨çš„èŠ‚ç‚¹æˆä¸ºLeader
4. å¿ƒè·³ç»´æŒï¼šLeaderå®šæœŸå‘é€å¿ƒè·³ä¿æŒé¢†å¯¼åœ°ä½

æ•…éšœæ¢å¤ï¼š
Leaderæ•…éšœ â†’ å‰©ä½™èŠ‚ç‚¹é‡æ–°é€‰ä¸¾ â†’ æ–°Leaderäº§ç”Ÿ
ç½‘ç»œåˆ†åŒº â†’ åªæœ‰å¤šæ•°æ´¾å¯ä»¥ç»§ç»­å·¥ä½œ
```

> ğŸ§  **è®°å¿†æŠ€å·§**ï¼š`Raftå°±åƒç­çº§é€‰ç­é•¿ï¼Œè¶…è¿‡åŠæ•°åŒå­¦åŒæ„ä½ æ‰èƒ½å½“é€‰ï¼Œå½“ç­é•¿å¤±è”æ—¶ä¼šé‡æ–°é€‰ä¸¾`

### 6.3 é«˜å¯ç”¨æœ€ä½³å®è·µ


**ğŸ“‹ ç”Ÿäº§ç¯å¢ƒé…ç½®æ¸…å•**ï¼š

| é…ç½®é¡¹ | **æ¨èå€¼** | **åŸå› ** |
|--------|------------|----------|
| Manageræ•°é‡ | `3ä¸ªæˆ–5ä¸ª` | ä¿è¯è¿‡åŠæ•°åŸåˆ™ |
| ç½‘ç»œå»¶è¿Ÿ | `< 50ms` | ä¿è¯å¿ƒè·³å’Œé€‰ä¸¾æ•ˆç‡ |
| ç£ç›˜IO | `SSD` | å¿«é€Ÿè¯»å†™é›†ç¾¤çŠ¶æ€ |
| å†…å­˜ | `â‰¥ 4GB` | å­˜å‚¨é›†ç¾¤å…ƒæ•°æ® |
| å¤‡ä»½ç­–ç•¥ | `æ¯æ—¥å¤‡ä»½` | å¿«é€Ÿæ¢å¤é›†ç¾¤çŠ¶æ€ |

**ğŸ”§ é«˜å¯ç”¨éƒ¨ç½²ç¤ºä¾‹**ï¼š
```bash
# åœ¨ä¸‰ä¸ªä¸åŒçš„æœåŠ¡å™¨ä¸Šåˆ†åˆ«æ‰§è¡Œ

# æœåŠ¡å™¨1ï¼šåˆå§‹åŒ–é›†ç¾¤
docker swarm init --advertise-addr 10.0.1.10

# æœåŠ¡å™¨2ï¼šåŠ å…¥ä¸ºManager
docker swarm join --token <manager-token> 10.0.1.10:2377

# æœåŠ¡å™¨3ï¼šåŠ å…¥ä¸ºManager  
docker swarm join --token <manager-token> 10.0.1.10:2377

# éªŒè¯é«˜å¯ç”¨é…ç½®
docker node ls
# åº”è¯¥çœ‹åˆ°3ä¸ªManagerèŠ‚ç‚¹ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯Leader
```

**ğŸš¨ æ•…éšœæµ‹è¯•**ï¼š
```bash
# æ¨¡æ‹ŸLeaderèŠ‚ç‚¹æ•…éšœ
docker node update --availability drain <leader-node>

# è§‚å¯Ÿæ–°Leaderé€‰ä¸¾
docker node ls
# åº”è¯¥çœ‹åˆ°æ–°çš„Leaderè¢«é€‰å‡º

# æ¢å¤èŠ‚ç‚¹
docker node update --availability active <leader-node>
```

### 6.4 ç›‘æ§ä¸ç»´æŠ¤


**ğŸ“Š é›†ç¾¤å¥åº·æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥é›†ç¾¤æ•´ä½“çŠ¶æ€
docker system info

# æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€
docker node ls

# æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
docker service ls

# æ£€æŸ¥å…·ä½“æœåŠ¡çš„ä»»åŠ¡åˆ†å¸ƒ
docker service ps <service-name>
```

**ğŸ”§ ç»´æŠ¤æ“ä½œ**ï¼š
```bash
# å®‰å…¨åœ°ç»´æŠ¤ManagerèŠ‚ç‚¹
# 1. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ManagerèŠ‚ç‚¹åœ¨çº¿
docker node ls | grep Manager

# 2. æ’ç©ºè¦ç»´æŠ¤çš„èŠ‚ç‚¹
docker node update --availability drain manager2

# 3. ç»´æŠ¤å®Œæˆåé‡æ–°æ¿€æ´»
docker node update --availability active manager2
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


ğŸ”¥ **åŸºç¡€å¿…çŸ¥**ï¼š
- **Docker Swarm**ï¼šDockeråŸç”Ÿé›†ç¾¤ç®¡ç†å·¥å…·ï¼Œè®©å¤šå°ä¸»æœºåƒä¸€å°ä¸»æœºä¸€æ ·å·¥ä½œ
- **ManagerèŠ‚ç‚¹**ï¼šé›†ç¾¤å¤§è„‘ï¼Œè´Ÿè´£è°ƒåº¦å’Œç®¡ç†ï¼ˆéœ€è¦å¥‡æ•°ä¸ªï¼‰
- **WorkerèŠ‚ç‚¹**ï¼šé›†ç¾¤åŠ³åŠ¨åŠ›ï¼Œä¸“é—¨è¿è¡Œå®¹å™¨ä»»åŠ¡
- **Overlayç½‘ç»œ**ï¼šè·¨ä¸»æœºå®¹å™¨é€šä¿¡çš„è™šæ‹Ÿç½‘ç»œ
- **Joinä»¤ç‰Œ**ï¼šæ§åˆ¶èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å®‰å…¨å¯†é’¥

### 7.2 å…³é”®æ“ä½œå‘½ä»¤


**ğŸ› ï¸ å¿…ä¼šå‘½ä»¤**ï¼š

| æ“ä½œç±»å‹ | **å‘½ä»¤** | **ä½œç”¨** |
|----------|----------|----------|
| `é›†ç¾¤åˆå§‹åŒ–` | `docker swarm init` | åˆ›å»ºæ–°é›†ç¾¤ |
| `èŠ‚ç‚¹åŠ å…¥` | `docker swarm join` | åŠ å…¥ç°æœ‰é›†ç¾¤ |
| `èŠ‚ç‚¹æŸ¥çœ‹` | `docker node ls` | æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ |
| `ä»¤ç‰Œç®¡ç†` | `docker swarm join-token` | è·å–åŠ å…¥ä»¤ç‰Œ |
| `ç½‘ç»œåˆ›å»º` | `docker network create --driver overlay` | åˆ›å»ºè·¨ä¸»æœºç½‘ç»œ |

### 7.3 é‡è¦ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆManagerè¦å¥‡æ•°ä¸ª**ï¼š
```
Raftç®—æ³•è¦æ±‚ï¼šè¿‡åŠæ•°èŠ‚ç‚¹åŒæ„æ‰èƒ½åšå†³ç­–
â€¢ 3ä¸ªManagerï¼šæœ€å¤šå®¹å¿1ä¸ªæ•…éšœ
â€¢ 4ä¸ªManagerï¼šä»ç„¶åªèƒ½å®¹å¿1ä¸ªæ•…éšœï¼ˆæµªè´¹èµ„æºï¼‰  
â€¢ 5ä¸ªManagerï¼šæœ€å¤šå®¹å¿2ä¸ªæ•…éšœ
```

**ğŸ”¹ é›†ç¾¤ç½‘ç»œçš„å±‚æ¬¡**ï¼š
```
åº”ç”¨å±‚ï¼šæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
ç½‘ç»œå±‚ï¼šOverlayè·¨ä¸»æœºé€šä¿¡
ä¼ è¾“å±‚ï¼šTLSåŠ å¯†ä¿è¯å®‰å…¨
```

**ğŸ”¹ é«˜å¯ç”¨çš„æ ¸å¿ƒ**ï¼š
```
åˆ†å¸ƒå¼ + å†—ä½™ + è‡ªåŠ¨æ¢å¤ = é«˜å¯ç”¨
â€¢ åˆ†å¸ƒå¼ï¼šä¸åŒæœºæˆ¿éƒ¨ç½²
â€¢ å†—ä½™ï¼šå¤šä¸ªManagerèŠ‚ç‚¹
â€¢ è‡ªåŠ¨æ¢å¤ï¼šæ•…éšœè‡ªåŠ¨åˆ‡æ¢
```

### 7.4 å®é™…åº”ç”¨ä»·å€¼


â­â­â­ **åº”ç”¨åœºæ™¯**ï¼š
- **å¾®æœåŠ¡éƒ¨ç½²**ï¼šå¤šä¸ªæœåŠ¡ååŒå·¥ä½œ
- **è´Ÿè½½å‡è¡¡**ï¼šè‡ªåŠ¨åˆ†å‘ç”¨æˆ·è¯·æ±‚
- **æ»šåŠ¨æ›´æ–°**ï¼šé›¶åœæœºæ›´æ–°åº”ç”¨
- **æ•…éšœæ¢å¤**ï¼šæœåŠ¡è‡ªåŠ¨è¿ç§»å’Œé‡å¯
- **å¼¹æ€§ä¼¸ç¼©**ï¼šæ ¹æ®è´Ÿè½½åŠ¨æ€è°ƒæ•´å®¹å™¨æ•°é‡

> ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼š
> 1. **å…ˆå•æœºå®è·µ**ï¼šåœ¨ä¸€å°æœºå™¨ä¸Šåˆ›å»ºå•èŠ‚ç‚¹é›†ç¾¤
> 2. **å†å¤šæœºæµ‹è¯•**ï¼šç”¨è™šæ‹Ÿæœºæ­å»ºçœŸå®é›†ç¾¤
> 3. **é€æ­¥æ·±å…¥**ï¼šä»åŸºç¡€åŠŸèƒ½åˆ°é«˜å¯ç”¨é…ç½®
> 4. **ç»“åˆå®é™…**ï¼šç”¨çœŸå®é¡¹ç›®éªŒè¯æ‰€å­¦çŸ¥è¯†

**ğŸ¯ æ ¸å¿ƒè®°å¿†**ï¼š
- Swarmè®©å¤šå°Dockerä¸»æœºå˜æˆä¸€å°è¶…çº§ä¸»æœº
- Managerç®¡ç†ï¼ŒWorkerå¹²æ´»ï¼Œä»¤ç‰Œæ§åˆ¶å‡†å…¥
- Overlayç½‘ç»œè®©å®¹å™¨è·¨ä¸»æœºå¦‚åŒæœ¬åœ°é€šä¿¡
- é«˜å¯ç”¨é å¥‡æ•°Managerå’Œåˆ†å¸ƒå¼éƒ¨ç½²å®ç°

> ğŸ“š **ä¸‹ä¸€æ­¥å­¦ä¹ **ï¼šæŒæ¡äº†é›†ç¾¤åŸºç¡€åï¼Œå¯ä»¥å­¦ä¹ æœåŠ¡éƒ¨ç½²ã€æ»šåŠ¨æ›´æ–°ã€ç§˜å¯†ç®¡ç†ç­‰é«˜çº§ç‰¹æ€§ï¼Œé€æ­¥æ„å»ºå®Œæ•´çš„å®¹å™¨åŒ–è¿ç»´ä½“ç³»ã€‚