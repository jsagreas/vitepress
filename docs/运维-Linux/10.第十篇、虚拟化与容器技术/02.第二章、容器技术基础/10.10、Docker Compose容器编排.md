---
title: 10ã€Docker Composeå®¹å™¨ç¼–æ’
---
## ğŸ“š ç›®å½•

1. [Docker ComposeåŸºç¡€æ¦‚å¿µ](#1-docker-composeåŸºç¡€æ¦‚å¿µ)
2. [docker-compose.ymlæ–‡ä»¶è¯­æ³•](#2-docker-composeymlæ–‡ä»¶è¯­æ³•)
3. [å¤šå®¹å™¨åº”ç”¨å®šä¹‰](#3-å¤šå®¹å™¨åº”ç”¨å®šä¹‰)
4. [æœåŠ¡ä¾èµ–å…³ç³»é…ç½®](#4-æœåŠ¡ä¾èµ–å…³ç³»é…ç½®)
5. [ç¯å¢ƒå˜é‡æ–‡ä»¶ç®¡ç†](#5-ç¯å¢ƒå˜é‡æ–‡ä»¶ç®¡ç†)
6. [ç½‘ç»œä¸æ•°æ®å·å£°æ˜](#6-ç½‘ç»œä¸æ•°æ®å·å£°æ˜)
7. [docker-composeå‘½ä»¤æ“ä½œ](#7-docker-composeå‘½ä»¤æ“ä½œ)
8. [æœåŠ¡æ‰©ç¼©å®¹ç®¡ç†](#8-æœåŠ¡æ‰©ç¼©å®¹ç®¡ç†)
9. [å¼€å‘ç¯å¢ƒå®¹å™¨ç¼–æ’](#9-å¼€å‘ç¯å¢ƒå®¹å™¨ç¼–æ’)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Docker ComposeåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Docker Compose


**ğŸ”¸ ç®€å•ç†è§£**
```
Docker Compose = å®¹å™¨ç•Œçš„"é¡¹ç›®ç®¡ç†å™¨"
```

å°±åƒä½ è¦åšä¸€ä¸ªç½‘ç«™é¡¹ç›®ï¼Œéœ€è¦ï¼š
- **å‰ç«¯æœåŠ¡**ï¼ˆç½‘é¡µç•Œé¢ï¼‰
- **åç«¯æœåŠ¡**ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰  
- **æ•°æ®åº“**ï¼ˆå­˜å‚¨æ•°æ®ï¼‰
- **ç¼“å­˜æœåŠ¡**ï¼ˆæå‡æ€§èƒ½ï¼‰

Docker Composeå¸®ä½ æŠŠè¿™äº›**ä¸åŒçš„å®¹å™¨**åƒæ­ç§¯æœ¨ä¸€æ ·ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ª**å®Œæ•´çš„åº”ç”¨ç³»ç»Ÿ**ã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Docker Compose


**ğŸ¤” ä¸ç”¨Composeçš„çƒ¦æ¼**

```
æ‰‹åŠ¨å¯åŠ¨å¤šä¸ªå®¹å™¨ï¼š

docker run -d --name mysql mysql:5.7
docker run -d --name redis redis:alpine  
docker run -d --name web --link mysql --link redis nginx
docker run -d --name api --link mysql --link redis node:14
```

é—®é¢˜å¾ˆæ˜æ˜¾ï¼š
- å‘½ä»¤**å¤ªé•¿å¤ªå¤æ‚**
- å®¹å™¨å¯åŠ¨**é¡ºåºè¦æ±‚ä¸¥æ ¼**
- **ç½‘ç»œé…ç½®**å¾ˆéº»çƒ¦
- **é‡å¤æ“ä½œ**å®¹æ˜“å‡ºé”™

**âœ… ç”¨Composeçš„ä¼˜åŠ¿**

> ğŸ“ **ä¸€å¥è¯æ€»ç»“**
> 
> ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸€æ¡å‘½ä»¤ï¼Œæå®šæ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰å®¹å™¨ï¼

```
åªéœ€è¦ï¼š
1. å†™ä¸€ä¸ª docker-compose.yml æ–‡ä»¶
2. æ‰§è¡Œ docker-compose up
3. æ‰€æœ‰å®¹å™¨è‡ªåŠ¨æŒ‰æ­£ç¡®é¡ºåºå¯åŠ¨
```

### 1.3 Compose vs Dockerçš„å…³ç³»


```
å…³ç³»ç±»æ¯”ï¼š
Docker     = å•ä¸ªæ¼”å‘˜
Compose    = æ•´ä¸ªå‰§ç»„çš„å¯¼æ¼”

Docker     = å•ä¸ªç§¯æœ¨å—  
Compose    = ç§¯æœ¨æ­å»ºè¯´æ˜ä¹¦
```

**æ ¸å¿ƒç†è§£**ï¼š
- **Docker**ï¼šç®¡ç†å•ä¸ªå®¹å™¨
- **Compose**ï¼šåè°ƒå¤šä¸ªå®¹å™¨ååŒå·¥ä½œ

---

## 2. ğŸ“„ docker-compose.ymlæ–‡ä»¶è¯­æ³•


### 2.1 æ–‡ä»¶åŸºæœ¬ç»“æ„


**ğŸ—ï¸ æ•´ä½“æ¶æ„**
```yaml
version: '3.8'          # æŒ‡å®šç‰ˆæœ¬

services:               # å®šä¹‰æ‰€æœ‰æœåŠ¡
  service1:             # æœåŠ¡å1
    # æœåŠ¡1çš„é…ç½®
  service2:             # æœåŠ¡å2  
    # æœåŠ¡2çš„é…ç½®

networks:               # å®šä¹‰ç½‘ç»œï¼ˆå¯é€‰ï¼‰
  # ç½‘ç»œé…ç½®

volumes:                # å®šä¹‰æ•°æ®å·ï¼ˆå¯é€‰ï¼‰
  # æ•°æ®å·é…ç½®
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼š
```
â”Œâ”€ ç”Ÿæ´»ç±»æ¯” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ docker-compose.yml =   â”‚
â”‚ è£…ä¿®è®¾è®¡å›¾çº¸           â”‚
â”‚                       â”‚
â”‚ version = å›¾çº¸ç‰ˆæœ¬     â”‚
â”‚ services = å„ä¸ªæˆ¿é—´    â”‚
â”‚ networks = æ°´ç”µçº¿è·¯    â”‚
â”‚ volumes = å‚¨ç‰©ç©ºé—´     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æœåŠ¡é…ç½®çš„æ ¸å¿ƒå­—æ®µ


| **å­—æ®µå** | **ä½œç”¨è¯´æ˜** | **ä¸¾ä¾‹** |
|-----------|-------------|---------|
| `image` | **æŒ‡å®šé•œåƒ** | `nginx:latest` |
| `build` | **æ„å»ºé•œåƒ** | `./dockerfileè·¯å¾„` |
| `ports` | **ç«¯å£æ˜ å°„** | `"8080:80"` |
| `volumes` | **æŒ‚è½½ç›®å½•** | `./data:/var/lib/data` |
| `environment` | **ç¯å¢ƒå˜é‡** | `DB_HOST=mysql` |
| `depends_on` | **ä¾èµ–å…³ç³»** | `mysql` |
| `networks` | **ç½‘ç»œè®¾ç½®** | `frontend` |
| `restart` | **é‡å¯ç­–ç•¥** | `always` |

### 2.3 æœ€ç®€å•çš„ä¾‹å­


**ğŸ”¸ å•ä¸ªWebæœåŠ¡**
```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    restart: always
```

è¿™ä¸ªé…ç½®åšäº†ä»€ä¹ˆï¼š
1. **å¯åŠ¨ä¸€ä¸ªnginxå®¹å™¨**
2. **æŠŠå®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°ä¸»æœº8080ç«¯å£**
3. **å®¹å™¨å´©æºƒæ—¶è‡ªåŠ¨é‡å¯**

**ğŸ§ª éªŒè¯æ–¹æ³•**ï¼š
- ä¿å­˜ä¸º`docker-compose.yml`
- è¿è¡Œ`docker-compose up`
- æµè§ˆå™¨è®¿é—®`http://localhost:8080`

---

## 3. ğŸ—ï¸ å¤šå®¹å™¨åº”ç”¨å®šä¹‰


### 3.1 ç»å…¸ä¸‰å±‚æ¶æ„ç¤ºä¾‹


**ğŸ­ åº”ç”¨åœºæ™¯**ï¼šæ­å»ºä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨

```
å‰ç«¯(Nginx) â†’ åç«¯(Node.js) â†’ æ•°æ®åº“(MySQL)
```

```yaml
version: '3.8'

services:
  # å‰ç«¯WebæœåŠ¡å™¨
  frontend:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./html:/usr/share/nginx/html
    depends_on:
      - backend
    
  # åç«¯APIæœåŠ¡
  backend:
    build: ./api
    ports:
      - "3000:3000"
    environment:
      - DB_HOST=database
      - DB_USER=root
      - DB_PASSWORD=123456
    depends_on:
      - database
      
  # æ•°æ®åº“æœåŠ¡
  database:
    image: mysql:5.7
    environment:
      - MYSQL_ROOT_PASSWORD=123456
      - MYSQL_DATABASE=myapp
    volumes:
      - mysql_data:/var/lib/mysql
    ports:
      - "3306:3306"

volumes:
  mysql_data:
```

### 3.2 é…ç½®è§£è¯»


**ğŸ” æ¯ä¸ªæœåŠ¡çš„èŒè´£**ï¼š

```
frontendæœåŠ¡ï¼ˆå‰ç«¯ï¼‰ï¼š
â”œâ”€ ä½¿ç”¨è½»é‡çº§çš„nginxé•œåƒ
â”œâ”€ å¯¹å¤–æš´éœ²80ç«¯å£æä¾›Webè®¿é—®
â”œâ”€ æŒ‚è½½é…ç½®æ–‡ä»¶å’Œé™æ€æ–‡ä»¶
â””â”€ ä¾èµ–backendæœåŠ¡å¯åŠ¨

backendæœåŠ¡ï¼ˆåç«¯ï¼‰ï¼š
â”œâ”€ ä½¿ç”¨æœ¬åœ°Dockerfileæ„å»º
â”œâ”€ é€šè¿‡ç¯å¢ƒå˜é‡è¿æ¥æ•°æ®åº“
â”œâ”€ ä¾èµ–databaseæœåŠ¡å¯åŠ¨
â””â”€ æä¾›APIæ¥å£æœåŠ¡

databaseæœåŠ¡ï¼ˆæ•°æ®åº“ï¼‰ï¼š
â”œâ”€ ä½¿ç”¨MySQL 5.7å®˜æ–¹é•œåƒ
â”œâ”€ è®¾ç½®rootå¯†ç å’Œé»˜è®¤æ•°æ®åº“
â”œâ”€ æ•°æ®æŒä¹…åŒ–åˆ°named volume
â””â”€ æœ€å…ˆå¯åŠ¨ï¼ˆè¢«å…¶ä»–æœåŠ¡ä¾èµ–ï¼‰
```

### 3.3 å¯åŠ¨é¡ºåº


**âš¡ è‡ªåŠ¨å¤„ç†å¯åŠ¨é¡ºåº**
```
å¯åŠ¨é¡ºåºï¼šdatabase â†’ backend â†’ frontend
åœæ­¢é¡ºåºï¼šfrontend â†’ backend â†’ database
```

> âš ï¸ **é‡è¦æé†’**
> 
> `depends_on`åªä¿è¯**å¯åŠ¨é¡ºåº**ï¼Œä¸ä¿è¯æœåŠ¡**å°±ç»ªçŠ¶æ€**
> æ•°æ®åº“å¯èƒ½è¿˜åœ¨åˆå§‹åŒ–æ—¶ï¼Œåç«¯å°±å¼€å§‹å°è¯•è¿æ¥äº†

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨åº”ç”¨ä»£ç ä¸­æ·»åŠ é‡è¯•æœºåˆ¶

---

## 4. ğŸ”— æœåŠ¡ä¾èµ–å…³ç³»é…ç½®


### 4.1 depends_onåŸºç¡€ç”¨æ³•


**ğŸ”¸ ç®€å•ä¾èµ–**
```yaml
services:
  web:
    image: nginx
    depends_on:
      - database      # webä¾èµ–database
      
  database:
    image: mysql:5.7
```

**ğŸ”¸ å¤æ‚ä¾èµ–å…³ç³»**
```yaml
services:
  frontend:
    image: nginx
    depends_on:
      - backend
      - cache
      
  backend:
    image: node:14
    depends_on:
      - database
      - cache
      
  database:
    image: mysql:5.7
    
  cache:
    image: redis:alpine
```

### 4.2 ä¾èµ–å…³ç³»å›¾ç¤º


```
å¯åŠ¨é¡ºåºåˆ†æï¼š
                   â”Œâ”€â†’ cache â”€â”
database â†’ backend â”¤          â”œâ”€â†’ frontend
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬1å±‚ï¼šdatabase, cache (å¹¶è¡Œå¯åŠ¨)
ç¬¬2å±‚ï¼šbackend (ç­‰ç¬¬1å±‚å¯åŠ¨å)  
ç¬¬3å±‚ï¼šfrontend (ç­‰ç¬¬2å±‚å¯åŠ¨å)
```

### 4.3 å¥åº·æ£€æŸ¥ä¾èµ–ï¼ˆé«˜çº§ï¼‰


**ğŸ¥ ç­‰å¾…æœåŠ¡çœŸæ­£å°±ç»ª**
```yaml
services:
  web:
    image: nginx
    depends_on:
      database:
        condition: service_healthy    # ç­‰æ•°æ®åº“å¥åº·æ£€æŸ¥é€šè¿‡
        
  database:
    image: mysql:5.7
    environment:
      - MYSQL_ROOT_PASSWORD=123456
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      timeout: 20s
      retries: 10
      interval: 10s
      start_period: 40s
```

**ğŸ’¡ å¥åº·æ£€æŸ¥è§£é‡Š**ï¼š
- `test`ï¼šæ£€æŸ¥å‘½ä»¤ï¼ˆpingæ•°æ®åº“ï¼‰
- `timeout`ï¼šå•æ¬¡æ£€æŸ¥è¶…æ—¶æ—¶é—´
- `retries`ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°
- `interval`ï¼šæ£€æŸ¥é—´éš”æ—¶é—´
- `start_period`ï¼šå®¹å™¨å¯åŠ¨åç­‰å¾…æ—¶é—´

---

## 5. ğŸŒ ç¯å¢ƒå˜é‡æ–‡ä»¶ç®¡ç†


### 5.1 ä¸ºä»€ä¹ˆè¦ç”¨ç¯å¢ƒå˜é‡


**ğŸ¤” é—®é¢˜åœºæ™¯**ï¼š
```
å¼€å‘ç¯å¢ƒï¼šæ•°æ®åº“ localhost:3306
æµ‹è¯•ç¯å¢ƒï¼šæ•°æ®åº“ test-db:3306  
ç”Ÿäº§ç¯å¢ƒï¼šæ•°æ®åº“ prod-db:3306
```

å¦‚æœå†™æ­»åœ¨é…ç½®æ–‡ä»¶é‡Œï¼Œæ¯ä¸ªç¯å¢ƒéƒ½è¦æ”¹é…ç½®ï¼Œå¤ªéº»çƒ¦ï¼

### 5.2 env_fileç”¨æ³•


**ğŸ“ é¡¹ç›®ç»“æ„**ï¼š
```
project/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env                    # é»˜è®¤ç¯å¢ƒå˜é‡æ–‡ä»¶
â”œâ”€â”€ .env.development        # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ .env.production         # ç”Ÿäº§ç¯å¢ƒ
â””â”€â”€ app/
```

**ğŸ”¸ .envæ–‡ä»¶å†…å®¹**ï¼š
```bash
# æ•°æ®åº“é…ç½®
DB_HOST=mysql
DB_PORT=3306
DB_NAME=myapp
DB_USER=root
DB_PASSWORD=secret123

# åº”ç”¨é…ç½®  
APP_PORT=3000
APP_ENV=development
JWT_SECRET=your-jwt-secret-key
```

### 5.3 åœ¨Composeä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡


**æ–¹æ³•ä¸€ï¼šç›´æ¥å¼•ç”¨.envæ–‡ä»¶**
```yaml
version: '3.8'

services:
  backend:
    image: node:14
    ports:
      - "${APP_PORT}:3000"      # ä½¿ç”¨ç¯å¢ƒå˜é‡
    environment:
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT}
      - DB_NAME=${DB_NAME}
      - JWT_SECRET=${JWT_SECRET}
    env_file:
      - .env                    # è½½å…¥æ•´ä¸ªæ–‡ä»¶
      
  database:
    image: mysql:5.7
    environment:
      - MYSQL_DATABASE=${DB_NAME}
      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD}
```

**æ–¹æ³•äºŒï¼šæŒ‡å®šä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶**
```yaml
services:
  app:
    image: myapp:latest
    env_file:
      - .env.${ENV:-development}    # é»˜è®¤development
```

ä½¿ç”¨æ–¹å¼ï¼š
```bash
# å¼€å‘ç¯å¢ƒ
ENV=development docker-compose up

# ç”Ÿäº§ç¯å¢ƒ  
ENV=production docker-compose up
```

### 5.4 ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§


**ğŸ¥‡ ä¼˜å…ˆçº§æ’åºï¼ˆé«˜åˆ°ä½ï¼‰**ï¼š
1. **å‘½ä»¤è¡Œ**ï¼š`docker-compose run -e VAR=value`
2. **shellç¯å¢ƒå˜é‡**ï¼š`export VAR=value`
3. **environmentå­—æ®µ**ï¼šåœ¨composeæ–‡ä»¶ä¸­ç›´æ¥è®¾ç½®
4. **env_file**ï¼šä»æ–‡ä»¶è¯»å–
5. **Dockerfileä¸­çš„ENV**ï¼šé•œåƒæ„å»ºæ—¶è®¾ç½®

---

## 6. ğŸŒ ç½‘ç»œä¸æ•°æ®å·å£°æ˜


### 6.1 ç½‘ç»œåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ é»˜è®¤ç½‘ç»œè¡Œä¸º**

å½“ä½ è¿è¡Œ`docker-compose up`æ—¶ï¼ŒComposeä¼šï¼š
1. **åˆ›å»ºä¸€ä¸ªé»˜è®¤ç½‘ç»œ**ï¼ˆé¡¹ç›®å_defaultï¼‰
2. **æ‰€æœ‰æœåŠ¡è‡ªåŠ¨åŠ å…¥è¿™ä¸ªç½‘ç»œ**
3. **æœåŠ¡é—´å¯ä»¥é€šè¿‡æœåŠ¡åç›¸äº’è®¿é—®**

```
project_defaultç½‘ç»œï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  frontend â†â†’ backend â†â†’ database â”‚
â”‚     â†‘            â†‘         â†‘    â”‚
â”‚  å¯é€šè¿‡æœåŠ¡åç›´æ¥è®¿é—®           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 è‡ªå®šä¹‰ç½‘ç»œé…ç½®


**ğŸ”¸ å¤šç½‘ç»œæ¶æ„**
```yaml
version: '3.8'

services:
  frontend:
    image: nginx
    networks:
      - frontend-net        # å‰ç«¯ç½‘ç»œ
      
  backend:
    image: node:14
    networks:
      - frontend-net        # è¿æ¥å‰ç«¯
      - backend-net         # è¿æ¥åç«¯
      
  database:
    image: mysql:5.7
    networks:
      - backend-net         # åªåœ¨åç«¯ç½‘ç»œ
      
networks:
  frontend-net:
    driver: bridge
  backend-net:  
    driver: bridge
    internal: true          # å†…éƒ¨ç½‘ç»œï¼Œä¸èƒ½è®¿é—®å¤–ç½‘
```

**ğŸ¯ ç½‘ç»œæ¶æ„å›¾**ï¼š
```
å¤–ç½‘ â†’ frontend-net â†’ backend-net
       (å…¬å¼€ç½‘ç»œ)     (å†…éƒ¨ç½‘ç»œ)
           â†“              â†“
        frontend      database
           â†“              â†‘
        backend â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      (è¿æ¥ä¸¤ä¸ªç½‘ç»œ)
```

### 6.3 æ•°æ®å·ç®¡ç†


**ğŸ”¸ æ•°æ®å·ç±»å‹å¯¹æ¯”**ï¼š

| **ç±»å‹** | **è¯­æ³•** | **ç”¨é€”** | **æ•°æ®ä½ç½®** |
|---------|---------|---------|-------------|
| **åŒ¿åå·** | `/var/lib/data` | **ä¸´æ—¶æ•°æ®** | Dockerç®¡ç† |
| **å…·åå·** | `mysql_data:/var/lib/mysql` | **æŒä¹…åŒ–æ•°æ®** | Dockerç®¡ç† |
| **ç»‘å®šæŒ‚è½½** | `./data:/var/lib/data` | **å¼€å‘è°ƒè¯•** | ä¸»æœºæŒ‡å®šç›®å½• |

### 6.4 æ•°æ®å·å®Œæ•´ç¤ºä¾‹


```yaml
version: '3.8'

services:
  web:
    image: nginx
    volumes:
      - ./html:/usr/share/nginx/html      # ç»‘å®šæŒ‚è½½ï¼šä»£ç æ–‡ä»¶
      - nginx_logs:/var/log/nginx         # å…·åå·ï¼šæ—¥å¿—æ–‡ä»¶
      
  database:
    image: mysql:5.7
    volumes:
      - mysql_data:/var/lib/mysql         # å…·åå·ï¼šæ•°æ®åº“æ–‡ä»¶
      - ./mysql/init:/docker-entrypoint-initdb.d  # ç»‘å®šæŒ‚è½½ï¼šåˆå§‹åŒ–è„šæœ¬
    environment:
      - MYSQL_ROOT_PASSWORD=123456

volumes:
  mysql_data:                             # å£°æ˜å…·åå·
    driver: local
  nginx_logs:
    driver: local
```

**ğŸ“‚ æ•°æ®æŒä¹…åŒ–ç­–ç•¥**ï¼š
```
å¼€å‘ç¯å¢ƒï¼šå¤šç”¨ç»‘å®šæŒ‚è½½ (æ–¹ä¾¿ä¿®æ”¹è°ƒè¯•)
ç”Ÿäº§ç¯å¢ƒï¼šå¤šç”¨å…·åå· (Dockerç»Ÿä¸€ç®¡ç†)
```

---

## 7. âŒ¨ï¸ docker-composeå‘½ä»¤æ“ä½œ


### 7.1 åŸºç¡€å‘½ä»¤


**ğŸ”¸ é¡¹ç›®ç”Ÿå‘½å‘¨æœŸç®¡ç†**

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up

# åå°å¯åŠ¨
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
docker-compose down -v

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart
```

**ğŸ§ª å®è·µå»ºè®®**ï¼š
```
å¼€å‘æ—¶ï¼šdocker-compose up (å‰å°è¿è¡Œï¼Œçœ‹æ—¥å¿—)
éƒ¨ç½²æ—¶ï¼šdocker-compose up -d (åå°è¿è¡Œ)
```

### 7.2 æœåŠ¡ç®¡ç†å‘½ä»¤


**ğŸ”¸ å•ä¸ªæœåŠ¡æ“ä½œ**

```bash
# å¯åŠ¨ç‰¹å®šæœåŠ¡
docker-compose up backend

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart web

# åœæ­¢ç‰¹å®šæœåŠ¡
docker-compose stop database

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs web

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
docker-compose logs -f backend
```

### 7.3 å¼€å‘è°ƒè¯•å‘½ä»¤


| **å‘½ä»¤** | **åŠŸèƒ½** | **ä½¿ç”¨åœºæ™¯** |
|---------|---------|-------------|
| `docker-compose exec <service> bash` | **è¿›å…¥å®¹å™¨** | è°ƒè¯•é—®é¢˜ |
| `docker-compose run --rm <service> sh` | **ä¸´æ—¶è¿è¡Œ** | æ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ |
| `docker-compose ps` | **æŸ¥çœ‹çŠ¶æ€** | æ£€æŸ¥æœåŠ¡è¿è¡Œæƒ…å†µ |
| `docker-compose top` | **æŸ¥çœ‹è¿›ç¨‹** | æ€§èƒ½ç›‘æ§ |
| `docker-compose build` | **é‡æ–°æ„å»º** | ä»£ç æ›´æ–°å |

**ğŸ”§ è°ƒè¯•æŠ€å·§ç¤ºä¾‹**ï¼š
```bash
# è¿›å…¥åç«¯å®¹å™¨è°ƒè¯•
docker-compose exec backend bash
root@container:/app# npm install  
root@container:/app# node debug.js

# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
docker-compose exec database mysql -u root -p
mysql> show databases;

# ä¸´æ—¶å¯åŠ¨ä¸€ä¸ªå·¥å…·å®¹å™¨
docker-compose run --rm backend npm install
```

### 7.4 ç¯å¢ƒç®¡ç†


**ğŸ”¸ å¤šç¯å¢ƒé…ç½®**
```bash
# ä½¿ç”¨ä¸åŒçš„composeæ–‡ä»¶
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up

# æŒ‡å®šé¡¹ç›®åç§°
docker-compose -p myproject up

# ä½¿ç”¨ç¯å¢ƒå˜é‡æ–‡ä»¶
docker-compose --env-file .env.production up
```

---

## 8. ğŸ“ˆ æœåŠ¡æ‰©ç¼©å®¹ç®¡ç†


### 8.1 æ°´å¹³æ‰©å±•åŸºç¡€


**ğŸ”¸ ä»€ä¹ˆæ˜¯æœåŠ¡æ‰©å±•**

ç®€å•è¯´å°±æ˜¯ï¼š**ä¸€ä¸ªæœåŠ¡è¿è¡Œå¤šä¸ªå‰¯æœ¬**

```
åŸæ¥ï¼š1ä¸ªwebå®¹å™¨å¤„ç†æ‰€æœ‰è¯·æ±‚
æ‰©å±•åï¼š3ä¸ªwebå®¹å™¨åˆ†æ‹…è¯·æ±‚å‹åŠ›
```

### 8.2 åŸºç¡€æ‰©ç¼©å®¹æ“ä½œ


**ğŸ”§ æ‰©å®¹å‘½ä»¤**ï¼š
```bash
# æ‰©å±•webæœåŠ¡åˆ°3ä¸ªå®ä¾‹
docker-compose up -d --scale web=3

# åŒæ—¶æ‰©å±•å¤šä¸ªæœåŠ¡
docker-compose up -d --scale web=3 --scale api=2

# ç¼©å®¹åˆ°1ä¸ªå®ä¾‹
docker-compose up -d --scale web=1
```

**ğŸ“Š æ‰©å®¹æ•ˆæœæŸ¥çœ‹**ï¼š
```bash
# æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨
docker-compose ps

#ç¤ºä¾‹è¾“å‡ºï¼š
Name              Command       State    Ports
project_web_1     nginx         Up       0.0.0.0:8080->80/tcp
project_web_2     nginx         Up       0.0.0.0:8081->80/tcp  
project_web_3     nginx         Up       0.0.0.0:8082->80/tcp
```

### 8.3 è´Ÿè½½å‡è¡¡é…ç½®


**ğŸ”¸ æ·»åŠ è´Ÿè½½å‡è¡¡å™¨**
```yaml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - web
      
  web:
    image: myapp:latest
    # ä¸æ˜ å°„ç«¯å£ï¼Œåªé€šè¿‡nginxè®¿é—®
    expose:
      - "3000"
      
networks:
  default:
    driver: bridge
```

**ğŸ”§ nginx.confé…ç½®**ï¼š
```nginx
upstream backend {
    server web:3000;        # Dockerä¼šè‡ªåŠ¨è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ªwebå®¹å™¨
}

server {
    listen 80;
    
    location / {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 8.4 æ‰©å®¹æœ€ä½³å®è·µ


**âœ… é€‚åˆæ‰©å®¹çš„æœåŠ¡**ï¼š
```
WebæœåŠ¡ï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œæ— çŠ¶æ€
APIæœåŠ¡ï¼šæä¾›æ¥å£ï¼Œä¸šåŠ¡é€»è¾‘å¤„ç†
è®¡ç®—æœåŠ¡ï¼šæ•°æ®å¤„ç†ï¼Œä»»åŠ¡é˜Ÿåˆ—æ¶ˆè´¹
```

**âŒ ä¸é€‚åˆæ‰©å®¹çš„æœåŠ¡**ï¼š
```
æ•°æ®åº“ï¼šæœ‰çŠ¶æ€ï¼Œéœ€è¦ä¸»ä»å¤åˆ¶æ–¹æ¡ˆ
æ¶ˆæ¯é˜Ÿåˆ—ï¼šéœ€è¦é›†ç¾¤é…ç½®
æ–‡ä»¶å­˜å‚¨ï¼šéœ€è¦åˆ†å¸ƒå¼å­˜å‚¨æ–¹æ¡ˆ
```

**ğŸ¯ æ‰©å®¹ç­–ç•¥**ï¼š
```yaml
version: '3.8'

services:
  web:
    image: myapp:latest
    deploy:
      replicas: 3           # å£°æ˜å¼æ‰©å®¹
      resources:
        limits:
          cpus: '0.5'       # CPUé™åˆ¶  
          memory: 512M      # å†…å­˜é™åˆ¶
        reservations:
          memory: 256M      # å†…å­˜ä¿ç•™
```

---

## 9. ğŸ’» å¼€å‘ç¯å¢ƒå®¹å™¨ç¼–æ’


### 9.1 å¼€å‘ç¯å¢ƒçš„ç‰¹æ®Šéœ€æ±‚


**ğŸ”¸ å¼€å‘ vs ç”Ÿäº§ç¯å¢ƒå·®å¼‚**ï¼š

| **æ–¹é¢** | **å¼€å‘ç¯å¢ƒ** | **ç”Ÿäº§ç¯å¢ƒ** |
|---------|-------------|-------------|
| **ä»£ç æ›´æ–°** | å®æ—¶çƒ­é‡è½½ | æ„å»ºé•œåƒéƒ¨ç½² |
| **æ•°æ®æŒä¹…åŒ–** | ä¸´æ—¶æ•°æ® | æ°¸ä¹…å­˜å‚¨ |
| **è°ƒè¯•å·¥å…·** | éœ€è¦è°ƒè¯•ç«¯å£ | ä¸éœ€è¦ |
| **æ€§èƒ½è¦æ±‚** | å¼€å‘ä¾¿åˆ©ä¼˜å…ˆ | æ€§èƒ½ä¼˜å…ˆ |
| **å®‰å…¨æ€§** | ç›¸å¯¹å®½æ¾ | ä¸¥æ ¼å®‰å…¨ |

### 9.2 å¼€å‘ç¯å¢ƒé…ç½®ç¤ºä¾‹


**ğŸ”¸ å‰ç«¯å¼€å‘ç¯å¢ƒ**ï¼š
```yaml
version: '3.8'

services:
  # å‰ç«¯å¼€å‘æœåŠ¡å™¨
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev    # å¼€å‘ä¸“ç”¨Dockerfile
    ports:
      - "3000:3000"               # Reactå¼€å‘æœåŠ¡å™¨
      - "35729:35729"             # çƒ­é‡è½½ç«¯å£
    volumes:
      - ./frontend/src:/app/src   # æºç çƒ­æŒ‚è½½
      - ./frontend/public:/app/public
      - node_modules:/app/node_modules  # ç¼“å­˜node_modules
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true  # æ–‡ä»¶ç›‘å¬(Windows/Mac)
    command: npm start
    
  # åç«¯å¼€å‘æœåŠ¡å™¨  
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    ports:
      - "8000:8000"              # APIæœåŠ¡ç«¯å£
      - "9229:9229"              # Node.jsè°ƒè¯•ç«¯å£
    volumes:
      - ./backend:/app           # æ•´ä¸ªåç«¯ç›®å½•æŒ‚è½½
      - /app/node_modules        # æ’é™¤node_modules
    environment:
      - NODE_ENV=development
      - DB_HOST=database
    command: nodemon --inspect=0.0.0.0:9229 app.js
    depends_on:
      - database
      
  # å¼€å‘æ•°æ®åº“
  database:
    image: mysql:5.7
    ports:
      - "3306:3306"              # æš´éœ²ç«¯å£ä¾¿äºè¿æ¥å·¥å…·
    environment:
      - MYSQL_ROOT_PASSWORD=dev123
      - MYSQL_DATABASE=devdb
    volumes:
      - mysql_dev_data:/var/lib/mysql
      - ./database/init:/docker-entrypoint-initdb.d

volumes:
  node_modules:
  mysql_dev_data:
```

### 9.3 å¼€å‘å·¥å…·é›†æˆ


**ğŸ”¸ Dockerfile.devç¤ºä¾‹**ï¼š
```dockerfile
FROM node:14

WORKDIR /app

# å®‰è£…å¼€å‘ä¾èµ–
COPY package*.json ./
RUN npm install

# å®‰è£…å…¨å±€å¼€å‘å·¥å…·
RUN npm install -g nodemon

# æš´éœ²è°ƒè¯•ç«¯å£
EXPOSE 8000 9229

CMD ["nodemon", "--inspect=0.0.0.0:9229", "app.js"]
```

### 9.4 å¼€å‘å·¥ä½œæµ


**ğŸ”„ å…¸å‹å¼€å‘æµç¨‹**ï¼š
```bash
# 1. å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker-compose up -d

# 2. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend

# 3. æ‰§è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec backend npm run migrate

# 4. å®‰è£…æ–°çš„ä¾èµ–åŒ…
docker-compose exec backend npm install express

# 5. é‡å¯æœåŠ¡(å¦‚æœéœ€è¦)
docker-compose restart backend

# 6. è¿›å…¥å®¹å™¨è°ƒè¯•
docker-compose exec backend bash

# 7. è¿è¡Œæµ‹è¯•
docker-compose exec backend npm test

# 8. åœæ­¢ç¯å¢ƒ
docker-compose down
```

**ğŸ’¡ å¼€å‘æŠ€å·§**ï¼š
```
â”Œâ”€ å¼€å‘æç¤º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä½¿ç”¨.dockerignore   â”‚
â”‚    æ’é™¤node_modules    â”‚
â”‚                       â”‚
â”‚ 2. è®¾ç½®æ–‡ä»¶ç›‘å¬        â”‚
â”‚    æ”¯æŒçƒ­é‡è½½          â”‚
â”‚                       â”‚
â”‚ 3. æš´éœ²è°ƒè¯•ç«¯å£        â”‚
â”‚    ä¾¿äºIDEè¿æ¥è°ƒè¯•     â”‚
â”‚                       â”‚
â”‚ 4. æŒ‚è½½æºç ç›®å½•        â”‚
â”‚    ä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Docker Compose = å¤šå®¹å™¨åº”ç”¨çš„ç®¡ç†å·¥å…·
ğŸ”¸ docker-compose.yml = åº”ç”¨çš„æ¶æ„æè¿°æ–‡ä»¶  
ğŸ”¸ services = åº”ç”¨çš„å„ä¸ªç»„ä»¶(æ•°æ®åº“ã€APIã€å‰ç«¯ç­‰)
ğŸ”¸ ä¾èµ–å…³ç³» = æ§åˆ¶å®¹å™¨å¯åŠ¨é¡ºåº
ğŸ”¸ ç¯å¢ƒå˜é‡ = ä¸åŒç¯å¢ƒçš„é…ç½®ç®¡ç†
ğŸ”¸ ç½‘ç»œ = å®¹å™¨é—´çš„é€šä¿¡æ–¹å¼
ğŸ”¸ æ•°æ®å· = æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆç”¨Compose**
```
é—®é¢˜ï¼šæ‰‹åŠ¨ç®¡ç†å¤šä¸ªå®¹å™¨å¾ˆéº»çƒ¦
è§£å†³ï¼šä¸€ä¸ªé…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†
ä¼˜åŠ¿ï¼šç®€å•ã€å¯é‡å¤ã€ç‰ˆæœ¬åŒ–
```

**ğŸ”¹ é…ç½®æ–‡ä»¶çš„ç²¾é«“**
```
version: æŒ‡å®šè¯­æ³•ç‰ˆæœ¬
services: å®šä¹‰åº”ç”¨ç»„ä»¶
networks: è®¾è®¡ç½‘ç»œæ¶æ„  
volumes: ç®¡ç†æ•°æ®å­˜å‚¨
```

**ğŸ”¹ å¼€å‘ vs ç”Ÿäº§çš„å·®å¼‚**
```
å¼€å‘ï¼šé‡è§†ä¾¿åˆ©æ€§ï¼Œä»£ç çƒ­é‡è½½ï¼Œè°ƒè¯•ç«¯å£
ç”Ÿäº§ï¼šé‡è§†æ€§èƒ½ï¼Œå®‰å…¨æ€§ï¼Œç¨³å®šæ€§
ç­–ç•¥ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„composeæ–‡ä»¶
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯**ï¼š
- **æœ¬åœ°å¼€å‘ç¯å¢ƒ**ï¼šä¸€é”®å¯åŠ¨å®Œæ•´é¡¹ç›®
- **æµ‹è¯•ç¯å¢ƒéƒ¨ç½²**ï¼šå¿«é€Ÿæ­å»ºæµ‹è¯•ç¯å¢ƒ  
- **CI/CDé›†æˆ**ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²
- **å¾®æœåŠ¡æ¶æ„**ï¼šç®¡ç†å¤šä¸ªæœåŠ¡ç»„ä»¶

**ğŸ”§ æœ€ä½³å®è·µè¦ç‚¹**ï¼š
```
é…ç½®ç®¡ç†ï¼š
âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡æ–‡ä»¶
âœ… ä¸åŒç¯å¢ƒåˆ†ç¦»é…ç½®
âœ… æ•æ„Ÿä¿¡æ¯ç”¨Docker secrets

ç½‘ç»œè§„åˆ’ï¼š
âœ… å‰ç«¯å’Œæ•°æ®åº“åˆ†ç¦»ç½‘ç»œ
âœ… åªæš´éœ²å¿…è¦çš„ç«¯å£
âœ… ä½¿ç”¨æœåŠ¡åè¿›è¡Œå†…éƒ¨é€šä¿¡

æ•°æ®ç®¡ç†ï¼š
âœ… å¼€å‘ç”¨ç»‘å®šæŒ‚è½½
âœ… ç”Ÿäº§ç”¨å…·åå·
âœ… é‡è¦æ•°æ®å®šæœŸå¤‡ä»½
```

### 10.4 å¸¸è§é—®é¢˜åŠè§£å†³


**ğŸ”¹ å®¹å™¨å¯åŠ¨é¡ºåºé—®é¢˜**
```
é—®é¢˜ï¼šæ•°æ®åº“è¿˜åœ¨å¯åŠ¨ï¼Œåº”ç”¨å°±å¼€å§‹è¿æ¥
è§£å†³ï¼šåœ¨åº”ç”¨ä»£ç ä¸­æ·»åŠ é‡è¯•é€»è¾‘
é«˜çº§ï¼šä½¿ç”¨healthcheckå¥åº·æ£€æŸ¥
```

**ğŸ”¹ ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ**
```
é—®é¢˜ï¼šä¿®æ”¹.envæ–‡ä»¶åæ²¡æœ‰ç”Ÿæ•ˆ
è§£å†³ï¼šé‡æ–°å¯åŠ¨å®¹å™¨ docker-compose up -d
æ³¨æ„ï¼šç¯å¢ƒå˜é‡ä¼˜å…ˆçº§çš„å½±å“
```

**ğŸ”¹ ç«¯å£å†²çªé—®é¢˜**
```
é—®é¢˜ï¼šç«¯å£å·²è¢«å ç”¨
è§£å†³ï¼šä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
æ£€æŸ¥ï¼šdocker ps æŸ¥çœ‹å·²å ç”¨ç«¯å£
```

**ğŸ¯ è®°å¿†è¦ç‚¹**ï¼š
```
ğŸ§  ä¸€å¥è¯ç²¾åï¼š
Composeè®©å¤šå®¹å™¨åº”ç”¨åƒå•ä½“åº”ç”¨ä¸€æ ·ç®€å•ç®¡ç†

ğŸ”‘ æ ¸å¿ƒæ“ä½œï¼š
upå¯åŠ¨ã€downåœæ­¢ã€logsæŸ¥çœ‹ã€execè¿›å…¥

ğŸ“ é…ç½®è¦ç´ ï¼š
é•œåƒ+ç«¯å£+å·+ç½‘ç»œ+ç¯å¢ƒå˜é‡+ä¾èµ–å…³ç³»
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- **ä¸€ä¸ªæ–‡ä»¶ç®¡å…¨å±€ï¼Œå¤šä¸ªå®¹å™¨å˜ç®€å•**
- **æœåŠ¡ä¾èµ–è¦ç†æ¸…ï¼Œç¯å¢ƒå˜é‡åˆ†å¼€ç®¡**  
- **å¼€å‘ç”Ÿäº§é…ç½®åˆ†ï¼Œç½‘ç»œæ•°æ®è¦è§„åˆ’**
- **å‘½ä»¤æ“ä½œè¦ç†Ÿç»ƒï¼Œé—®é¢˜æ’æŸ¥æœ‰æ–¹æ³•**