---
title: 10ã€é›†ç¾¤ç›‘æ§ä¸æ—¥å¿—ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [Kubernetesç›‘æ§ä¸æ—¥å¿—æ¦‚è¿°](#1-Kubernetesç›‘æ§ä¸æ—¥å¿—æ¦‚è¿°)
2. [Metrics Serverèµ„æºæŒ‡æ ‡æ”¶é›†](#2-Metrics-Serverèµ„æºæŒ‡æ ‡æ”¶é›†)
3. [Prometheusç›‘æ§æ ˆéƒ¨ç½²é…ç½®](#3-Prometheusç›‘æ§æ ˆéƒ¨ç½²é…ç½®)
4. [æ—¥å¿—æ”¶é›†æ¶æ„è®¾è®¡](#4-æ—¥å¿—æ”¶é›†æ¶æ„è®¾è®¡)
5. [é›†ç¾¤äº‹ä»¶ç›‘æ§ä¸å‘Šè­¦](#5-é›†ç¾¤äº‹ä»¶ç›‘æ§ä¸å‘Šè­¦)
6. [åº”ç”¨æ€§èƒ½ç›‘æ§APMé›†æˆ](#6-åº”ç”¨æ€§èƒ½ç›‘æ§APMé›†æˆ)
7. [åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªé…ç½®](#7-åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªé…ç½®)
8. [ç›‘æ§æ•°æ®å¯è§†åŒ–Grafana](#8-ç›‘æ§æ•°æ®å¯è§†åŒ–Grafana)
9. [æ—¥å¿—èšåˆä¸æœç´¢åˆ†æ](#9-æ—¥å¿—èšåˆä¸æœç´¢åˆ†æ)
10. [ç›‘æ§å‘Šè­¦è§„åˆ™é…ç½®](#10-ç›‘æ§å‘Šè­¦è§„åˆ™é…ç½®)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Kubernetesç›‘æ§ä¸æ—¥å¿—æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§å’Œæ—¥å¿—


**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
æƒ³è±¡ä½ åœ¨ç®¡ç†ä¸€ä¸ªå¤§å‹å·¥å‚ï¼š
â€¢ ç›‘æ§ = å„ç§ä»ªè¡¨ç›˜ï¼Œæ˜¾ç¤ºæœºå™¨è¿è¡ŒçŠ¶æ€
â€¢ æ—¥å¿— = è®°å½•æœ¬ï¼Œè®°å½•æ¯ä¸ªæ“ä½œçš„è¯¦ç»†è¿‡ç¨‹
â€¢ å‘Šè­¦ = æŠ¥è­¦å™¨ï¼Œå‡ºç°é—®é¢˜æ—¶ç«‹å³é€šçŸ¥
```

**ğŸ¯ æ ¸å¿ƒä½œç”¨**
- **ç›‘æ§**ï¼šå®æ—¶äº†è§£é›†ç¾¤å¥åº·çŠ¶æ€ï¼Œé¢„é˜²é—®é¢˜å‘ç”Ÿ
- **æ—¥å¿—**ï¼šè®°å½•æ“ä½œå†å²ï¼Œé—®é¢˜å‘ç”Ÿæ—¶å¿«é€Ÿå®šä½æ ¹å› 
- **å‘Šè­¦**ï¼šç¬¬ä¸€æ—¶é—´å‘ç°å¼‚å¸¸ï¼Œå‡å°‘æ•…éšœå½±å“æ—¶é—´
- **åˆ†æ**ï¼šé€šè¿‡æ•°æ®åˆ†æä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½

### 1.2 K8sç›‘æ§çš„ä¸‰ä¸ªå±‚æ¬¡


```
ç›‘æ§å±‚æ¬¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨å±‚ç›‘æ§                 â”‚ â† ä¸šåŠ¡æŒ‡æ ‡ã€ç”¨æˆ·ä½“éªŒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           å®¹å™¨å±‚ç›‘æ§                 â”‚ â† PodçŠ¶æ€ã€èµ„æºä½¿ç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           åŸºç¡€è®¾æ–½ç›‘æ§               â”‚ â† èŠ‚ç‚¹çŠ¶æ€ã€é›†ç¾¤å¥åº·
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç†è§£è¦ç‚¹ï¼š
â€¢ åŸºç¡€è®¾æ–½ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
â€¢ å®¹å™¨å±‚ï¼šPodæ•°é‡ã€é‡å¯æ¬¡æ•°ã€èµ„æºé…é¢
â€¢ åº”ç”¨å±‚ï¼šå“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€ä¸šåŠ¡æŒ‡æ ‡
```

### 1.3 ç›‘æ§æ•°æ®çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡


| æŒ‡æ ‡ç±»å‹ | **å«ä¹‰** | **ç¤ºä¾‹** | **é‡è¦æ€§** |
|---------|----------|----------|-----------|
| ğŸ” **å»¶è¿Ÿ** | `è¯·æ±‚å“åº”æ—¶é—´` | `APIè°ƒç”¨å¹³å‡500ms` | `ç”¨æˆ·ä½“éªŒç›´æ¥å½±å“` |
| ğŸ“Š **ååé‡** | `æ¯ç§’å¤„ç†è¯·æ±‚æ•°` | `1000 RPS` | `ç³»ç»Ÿå¤„ç†èƒ½åŠ›` |
| âŒ **é”™è¯¯ç‡** | `å¤±è´¥è¯·æ±‚ç™¾åˆ†æ¯”` | `5xxé”™è¯¯ç‡2%` | `ç³»ç»Ÿç¨³å®šæ€§` |
| ğŸ”§ **é¥±å’Œåº¦** | `èµ„æºä½¿ç”¨ç‡` | `CPUä½¿ç”¨ç‡85%` | `å®¹é‡è§„åˆ’ä¾æ®` |

---

## 2. ğŸ“Š Metrics Serverèµ„æºæŒ‡æ ‡æ”¶é›†


### 2.1 ä»€ä¹ˆæ˜¯Metrics Server


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
- **ä½œç”¨**ï¼šæ”¶é›†èŠ‚ç‚¹å’ŒPodçš„åŸºç¡€èµ„æºä½¿ç”¨æ•°æ®
- **å®šä½**ï¼šK8sé›†ç¾¤çš„"èµ„æºä½¿ç”¨æƒ…å†µä»ªè¡¨ç›˜"
- **æ•°æ®æº**ï¼šä»kubeletçš„APIè·å–CPUã€å†…å­˜ä½¿ç”¨é‡
- **ç”¨é€”**ï¼šæ”¯æŒ`kubectl top`å‘½ä»¤å’ŒHPAè‡ªåŠ¨æ‰©ç¼©å®¹

**ğŸ’¡ å·¥ä½œåŸç†**
```
æ•°æ®æµå‘ï¼š
kubelet â”€â”€â†’ Metrics Server â”€â”€â†’ API Server â”€â”€â†’ kubectl top
   â†‘              â†“
 cAdvisor     Metrics API
   â†‘              â†“
å®¹å™¨è¿è¡Œæ—¶      HPAæ§åˆ¶å™¨

ç®€å•è¯´å°±æ˜¯ï¼š
1. kubeletæ”¶é›†å®¹å™¨æ•°æ®
2. Metrics Serveræ±‡æ€»å¤„ç†
3. æä¾›æ ‡å‡†APIä¾›å…¶ä»–ç»„ä»¶ä½¿ç”¨
```

### 2.2 Metrics Serveréƒ¨ç½²é…ç½®


```yaml
# metrics-server.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metrics-server
  namespace: kube-system
spec:
  selector:
    matchLabels:
      k8s-app: metrics-server
  template:
    metadata:
      labels:
        k8s-app: metrics-server
    spec:
      containers:
      - name: metrics-server
        image: registry.k8s.io/metrics-server/metrics-server:v0.6.4
        args:
        - --cert-dir=/tmp
        - --secure-port=4443
        - --kubelet-preferred-address-types=InternalIP
        - --kubelet-use-node-status-port
        # æµ‹è¯•ç¯å¢ƒå¯æ·»åŠ ï¼ˆç”Ÿäº§ç¯å¢ƒä¸æ¨èï¼‰
        - --kubelet-insecure-tls
        resources:
          requests:
            cpu: 100m
            memory: 200Mi
        ports:
        - containerPort: 4443
          name: https
          protocol: TCP
```

**ğŸ”§ å¸¸ç”¨æ£€æŸ¥å‘½ä»¤**
```bash
# æ£€æŸ¥Metrics ServerçŠ¶æ€
kubectl get deployment metrics-server -n kube-system

# æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨
kubectl top nodes

# æŸ¥çœ‹Podèµ„æºä½¿ç”¨
kubectl top pods -A

# æŸ¥çœ‹ç‰¹å®šnamespaceçš„Podèµ„æº
kubectl top pods -n default
```

### 2.3 èµ„æºæŒ‡æ ‡çš„ç†è§£ä¸åº”ç”¨


**ğŸ“Š æŒ‡æ ‡å«ä¹‰è§£è¯»**
```
kubectl top nodes è¾“å‡ºç¤ºä¾‹ï¼š
NAME         CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   
master-01    250m         12%    2Gi             25%       
worker-01    1200m        30%    4Gi             50%       
worker-02    800m         20%    3Gi             37%       

ç†è§£è¦ç‚¹ï¼š
â€¢ CPU(cores)ï¼šå®é™…ä½¿ç”¨çš„CPUæ ¸å¿ƒæ•°ï¼Œ1000m = 1æ ¸
â€¢ CPU%ï¼šç›¸å¯¹äºèŠ‚ç‚¹æ€»CPUçš„ä½¿ç”¨ç™¾åˆ†æ¯”
â€¢ MEMORY(bytes)ï¼šå®é™…ä½¿ç”¨çš„å†…å­˜é‡
â€¢ MEMORY%ï¼šç›¸å¯¹äºèŠ‚ç‚¹æ€»å†…å­˜çš„ä½¿ç”¨ç™¾åˆ†æ¯”
```

---

## 3. âš¡ Prometheusç›‘æ§æ ˆéƒ¨ç½²é…ç½®


### 3.1 Prometheusç›‘æ§æ¶æ„æ¦‚è¿°


**ğŸ—ï¸ å®Œæ•´ç›‘æ§æ ˆæ¶æ„**
```
ç›‘æ§æ•°æ®æµå‘å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨Pod   â”‚â”€â”€â”€â–¶â”‚ ServiceMonitorâ”‚â”€â”€â”€â–¶â”‚ Prometheus  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                     â”‚
       â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Exporter  â”‚â”€â”€â”€â–¶â”‚    Rules    â”‚â”€â”€â”€â–¶â”‚  Grafana    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                     â”‚
       â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   kubelet   â”‚    â”‚ AlertManagerâ”‚    â”‚   ç”¨æˆ·ç•Œé¢   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒç»„ä»¶åŠŸèƒ½è¯´æ˜


| ç»„ä»¶ | **ä½œç”¨** | **é€šä¿—ç†è§£** |
|------|----------|-------------|
| ğŸ¯ **Prometheus** | `ç›‘æ§æ•°æ®æ”¶é›†å’Œå­˜å‚¨` | `åƒæ•°æ®æ”¶é›†å‘˜ï¼Œåˆ°å¤„é‡‡é›†æŒ‡æ ‡æ•°æ®` |
| ğŸ“Š **Grafana** | `æ•°æ®å¯è§†åŒ–å±•ç¤º` | `åƒè®¾è®¡å¸ˆï¼ŒæŠŠæ•°æ®åšæˆæ¼‚äº®å›¾è¡¨` |
| ğŸš¨ **AlertManager** | `å‘Šè­¦è§„åˆ™å¤„ç†å’Œé€šçŸ¥` | `åƒä¿å®‰ï¼Œå‘ç°é—®é¢˜å°±é€šçŸ¥ç›¸å…³äººå‘˜` |
| ğŸ“¡ **Exporters** | `æš´éœ²å„ç§ç³»ç»ŸæŒ‡æ ‡` | `åƒç¿»è¯‘å®˜ï¼ŒæŠŠç³»ç»Ÿæ•°æ®ç¿»è¯‘æˆæ ‡å‡†æ ¼å¼` |

### 3.3 ä½¿ç”¨kube-prometheus-stackå¿«é€Ÿéƒ¨ç½²


```bash
# æ·»åŠ Prometheusç¤¾åŒºHelmä»“åº“
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update

# åˆ›å»ºç›‘æ§å‘½åç©ºé—´
kubectl create namespace monitoring

# å®‰è£…å®Œæ•´ç›‘æ§æ ˆ
helm install prometheus-stack prometheus-community/kube-prometheus-stack \
  --namespace monitoring \
  --set grafana.adminPassword=admin123 \
  --set prometheus.prometheusSpec.storageSpec.volumeClaimTemplate.spec.resources.requests.storage=50Gi
```

**ğŸ“‹ éƒ¨ç½²åæ£€æŸ¥æ¸…å•**
- [ ] Prometheus Serverè¿è¡Œæ­£å¸¸
- [ ] Grafana Dashboardå¯è®¿é—®
- [ ] AlertManageré…ç½®æ­£ç¡®
- [ ] Node Exporteræ”¶é›†èŠ‚ç‚¹æŒ‡æ ‡
- [ ] å„ç§ServiceMonitoråˆ›å»ºæˆåŠŸ

---

## 4. ğŸ“ æ—¥å¿—æ”¶é›†æ¶æ„è®¾è®¡


### 4.1 K8sæ—¥å¿—æ”¶é›†çš„æŒ‘æˆ˜


**ğŸ¯ æ ¸å¿ƒæŒ‘æˆ˜**
```
å®¹å™¨æ—¥å¿—ç‰¹ç‚¹ï¼š
â€¢ çŸ­æš‚æ€§ï¼šPodåˆ é™¤åæ—¥å¿—ä¸¢å¤±
â€¢ åˆ†æ•£æ€§ï¼šæ—¥å¿—åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹
â€¢ æ ¼å¼å¤šæ ·ï¼šåº”ç”¨æ—¥å¿—æ ¼å¼å„ä¸ç›¸åŒ
â€¢ é‡çº§å¤§ï¼šç”Ÿäº§ç¯å¢ƒæ—¥å¿—é‡å·¨å¤§

è§£å†³æ–¹æ¡ˆï¼š
ç»Ÿä¸€æ”¶é›† â†’ é›†ä¸­å­˜å‚¨ â†’ ç»“æ„åŒ–åˆ†æ
```

### 4.2 æ—¥å¿—æ”¶é›†æ¶æ„æ¨¡å¼


**æ¨¡å¼ä¸€ï¼šèŠ‚ç‚¹çº§åˆ«æ”¶é›†ï¼ˆæ¨èï¼‰**
```
æ¶æ„å›¾ï¼š
æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Node                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Pod A  â”‚  â”‚  Pod B  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚           â”‚                â”‚
â”‚       â–¼           â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Fluentd/Fluent Bit    â”‚â”€â”€â”€â”¼â”€â”€â†’ é›†ä¸­æ—¥å¿—å­˜å‚¨
â”‚  â”‚      (DaemonSetéƒ¨ç½²)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼š
â€¢ èµ„æºæ¶ˆè€—ä½ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªæ”¶é›†å™¨
â€¢ é…ç½®ç»Ÿä¸€ï¼Œä¾¿äºç®¡ç†
â€¢ å¯¹åº”ç”¨æ— ä¾µå…¥
```

### 4.3 Fluent Bit vs Fluentdé€‰æ‹©


| ç‰¹æ€§ | **Fluent Bit** | **Fluentd** |
|------|----------------|-------------|
| ğŸ”‹ **èµ„æºæ¶ˆè€—** | `æä½ (~10MBå†…å­˜)` | `è¾ƒé«˜ (~100MB+å†…å­˜)` |
| âš¡ **æ€§èƒ½** | `é«˜æ€§èƒ½ï¼ŒCè¯­è¨€ç¼–å†™` | `ä¸­ç­‰æ€§èƒ½ï¼ŒRubyç¼–å†™` |
| ğŸ”§ **é…ç½®å¤æ‚åº¦** | `ç®€å•ï¼Œä¸“æ³¨æ—¥å¿—æ”¶é›†` | `å¤æ‚ï¼ŒåŠŸèƒ½ä¸°å¯Œ` |
| ğŸ”Œ **æ’ä»¶ç”Ÿæ€** | `ç²¾é€‰æ’ä»¶ï¼Œè¶³å¤Ÿä½¿ç”¨` | `æ’ä»¶ä¸°å¯Œï¼ŒåŠŸèƒ½å…¨é¢` |
| ğŸ“Š **æ•°æ®å¤„ç†** | `åŸºç¡€è¿‡æ»¤å’Œè½¬æ¢` | `å¼ºå¤§çš„æ•°æ®å¤„ç†èƒ½åŠ›` |

**ğŸ’¡ é€‰æ‹©å»ºè®®**
- **è¾¹ç¼˜æ”¶é›†**ï¼šä½¿ç”¨Fluent Bitï¼ˆè½»é‡ã€é«˜æ•ˆï¼‰
- **ä¸­å¿ƒå¤„ç†**ï¼šä½¿ç”¨Fluentdï¼ˆåŠŸèƒ½ä¸°å¯Œã€å¤„ç†èƒ½åŠ›å¼ºï¼‰
- **æ··åˆæ¶æ„**ï¼šFluent Bitæ”¶é›† â†’ Fluentdèšåˆå¤„ç†

### 4.4 Fluent Bitéƒ¨ç½²é…ç½®


```yaml
# fluent-bit-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluent-bit-config
  namespace: kube-system
data:
  fluent-bit.conf: |
    [SERVICE]
        Flush         1
        Log_Level     info
        Daemon        off
        
    [INPUT]
        Name              tail
        Path              /var/log/containers/*.log
        Parser            cri
        Tag               kube.*
        Refresh_Interval  5
        
    [FILTER]
        Name                kubernetes
        Match               kube.*
        Kube_URL            https://kubernetes.default.svc:443
        Merge_Log           On
        Keep_Log            Off
        K8S-Logging.Parser  On
        K8S-Logging.Exclude On
        
    [OUTPUT]
        Name  es
        Match *
        Host  elasticsearch.logging.svc.cluster.local
        Port  9200
        Index fluent-bit
```

---

## 5. ğŸš¨ é›†ç¾¤äº‹ä»¶ç›‘æ§ä¸å‘Šè­¦


### 5.1 K8säº‹ä»¶ç³»ç»Ÿç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯K8säº‹ä»¶**
- **å®šä¹‰**ï¼šé›†ç¾¤ä¸­å‘ç”Ÿçš„é‡è¦æ“ä½œè®°å½•
- **ç±»å‹**ï¼šPodåˆ›å»ºã€è°ƒåº¦å¤±è´¥ã€é•œåƒæ‹‰å–ã€å­˜å‚¨æŒ‚è½½ç­‰
- **ç‰¹ç‚¹**ï¼šè‡ªåŠ¨ç”Ÿæˆï¼Œé»˜è®¤ä¿ç•™1å°æ—¶
- **ä»·å€¼**ï¼šå¿«é€Ÿè¯Šæ–­é—®é¢˜ï¼Œäº†è§£é›†ç¾¤åŠ¨æ€

```bash
# æŸ¥çœ‹é›†ç¾¤äº‹ä»¶
kubectl get events --sort-by=.metadata.creationTimestamp

# æŸ¥çœ‹ç‰¹å®šnamespaceäº‹ä»¶
kubectl get events -n kube-system

# ç›‘å¬å®æ—¶äº‹ä»¶
kubectl get events --watch
```

### 5.2 äº‹ä»¶ç›‘æ§å·¥å…·é…ç½®


**EventRouteréƒ¨ç½²**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: eventrouter
  namespace: kube-system
spec:
  selector:
    matchLabels:
      app: eventrouter
  template:
    metadata:
      labels:
        app: eventrouter
    spec:
      containers:
      - name: kube-eventrouter
        image: gcr.io/heptio-images/eventrouter:v0.3
        imagePullPolicy: IfNotPresent
        volumeMounts:
        - name: config-volume
          mountPath: /etc/eventrouter
      volumes:
      - name: config-volume
        configMap:
          name: eventrouter-cm
      serviceAccount: eventrouter
```

### 5.3 å…³é”®äº‹ä»¶å‘Šè­¦è§„åˆ™


```yaml
# prometheus-rules.yaml
groups:
- name: kubernetes-events
  rules:
  - alert: PodCrashLooping
    expr: rate(kubernetes_pod_container_status_restarts_total[15m]) > 0
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Pod {{ $labels.pod }} åœ¨å‘½åç©ºé—´ {{ $labels.namespace }} ä¸­é¢‘ç¹é‡å¯"
      
  - alert: NodeNotReady
    expr: kube_node_status_condition{condition="Ready",status="false"} == 1
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "èŠ‚ç‚¹ {{ $labels.node }} çŠ¶æ€å¼‚å¸¸"
```

**ğŸ“‹ é‡ç‚¹å…³æ³¨çš„äº‹ä»¶ç±»å‹**
- **Failed**ï¼šæ“ä½œå¤±è´¥ï¼ˆè°ƒåº¦å¤±è´¥ã€é•œåƒæ‹‰å–å¤±è´¥ï¼‰
- **FailedMount**ï¼šå­˜å‚¨æŒ‚è½½å¤±è´¥
- **Unhealthy**ï¼šå¥åº·æ£€æŸ¥å¤±è´¥
- **BackOff**ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥é€€é¿
- **OOMKilling**ï¼šå†…å­˜ä¸è¶³æ€æ­»è¿›ç¨‹

---

## 6. ğŸ” åº”ç”¨æ€§èƒ½ç›‘æ§APMé›†æˆ


### 6.1 APMç›‘æ§çš„ä»·å€¼


**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
APMå°±åƒç»™åº”ç”¨è£…ä¸Šäº†"æ™ºèƒ½æ‰‹ç¯"ï¼š
â€¢ å¿ƒç‡ = å“åº”æ—¶é—´
â€¢ æ­¥æ•° = è¯·æ±‚æ•°é‡  
â€¢ ç¡çœ è´¨é‡ = é”™è¯¯ç‡
â€¢ è¿åŠ¨è½¨è¿¹ = è°ƒç”¨é“¾è·¯

å¸®ä½ å…¨é¢äº†è§£åº”ç”¨çš„"å¥åº·çŠ¶å†µ"
```

**ğŸ¯ APMæ ¸å¿ƒåŠŸèƒ½**
- **æ€§èƒ½ç›‘æ§**ï¼šå“åº”æ—¶é—´ã€ååé‡ã€é”™è¯¯ç‡
- **è°ƒç”¨é“¾è¿½è¸ª**ï¼šè¯·æ±‚åœ¨å„æœåŠ¡é—´çš„å®Œæ•´è·¯å¾„
- **ä»£ç çº§åˆ†æ**ï¼šå…·ä½“åˆ°å‡½æ•°å’ŒSQLçš„æ€§èƒ½åˆ†æ
- **ç”¨æˆ·ä½“éªŒ**ï¼šçœŸå®ç”¨æˆ·è®¿é—®ä½“éªŒç›‘æ§

### 6.2 ä¸»æµAPMè§£å†³æ–¹æ¡ˆ


| æ–¹æ¡ˆ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **é›†æˆéš¾åº¦** |
|------|----------|-------------|-------------|
| ğŸ”§ **Jaeger** | `å¼€æºï¼Œé“¾è·¯è¿½è¸ªä¸“å®¶` | `å¾®æœåŠ¡æ¶æ„` | `ä¸­ç­‰` |
| ğŸ“Š **Zipkin** | `è½»é‡çº§ï¼ŒTwitterå¼€æº` | `ç®€å•é“¾è·¯è¿½è¸ª` | `ç®€å•` |
| ğŸŒŸ **SkyWalking** | `å›½äº§å¼€æºï¼ŒåŠŸèƒ½å…¨é¢` | `Javaåº”ç”¨ç›‘æ§` | `ç®€å•` |
| ğŸ’° **New Relic** | `å•†ä¸šäº§å“ï¼ŒåŠŸèƒ½å¼ºå¤§` | `ä¼ä¸šçº§åº”ç”¨` | `ç®€å•` |

### 6.3 SkyWalkingåœ¨K8sä¸­çš„éƒ¨ç½²


```yaml
# skywalking-oap.yaml - åç«¯æœåŠ¡
apiVersion: apps/v1
kind: Deployment
metadata:
  name: skywalking-oap
  namespace: skywalking
spec:
  selector:
    matchLabels:
      app: skywalking-oap
  template:
    metadata:
      labels:
        app: skywalking-oap
    spec:
      containers:
      - name: oap
        image: apache/skywalking-oap-server:9.3.0
        env:
        - name: SW_STORAGE
          value: elasticsearch
        - name: SW_STORAGE_ES_CLUSTER_NODES
          value: elasticsearch:9200
        ports:
        - containerPort: 1234  # gRPCæ¥æ”¶æ•°æ®
        - containerPort: 11800 # HTTPæ¥æ”¶æ•°æ®
```

**ğŸ”§ åº”ç”¨é›†æˆç¤ºä¾‹ï¼ˆJavaï¼‰**
```bash
# åœ¨åº”ç”¨Podä¸­æ·»åŠ SkyWalking Agent
spec:
  containers:
  - name: my-app
    image: my-app:latest
    env:
    - name: JAVA_OPTS
      value: "-javaagent:/opt/skywalking/skywalking-agent.jar 
              -Dskywalking.agent.service_name=my-service
              -Dskywalking.collector.backend_service=skywalking-oap:11800"
```

---

## 7. ğŸ”— åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªé…ç½®


### 7.1 åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªçš„å¿…è¦æ€§


**ğŸ¯ å¾®æœåŠ¡ç¯å¢ƒçš„å¤æ‚æ€§**
```
å•ä½“åº”ç”¨æ—¶ä»£ï¼š
ç”¨æˆ·è¯·æ±‚ â”€â”€â†’ åº”ç”¨æœåŠ¡ â”€â”€â†’ æ•°æ®åº“
         ç®€å•ç›´æ¥ï¼Œé—®é¢˜å®¹æ˜“å®šä½

å¾®æœåŠ¡æ—¶ä»£ï¼š
ç”¨æˆ·è¯·æ±‚ â”€â”€â†’ ç½‘å…³ â”€â”€â†’ ç”¨æˆ·æœåŠ¡ â”€â”€â†’ è®¢å•æœåŠ¡ â”€â”€â†’ æ”¯ä»˜æœåŠ¡
                â†“          â†“          â†“
            è®¤è¯æœåŠ¡    åº“å­˜æœåŠ¡    æ¶ˆæ¯é˜Ÿåˆ—
                            â†“          â†“
                        ç‰©æµæœåŠ¡    é€šçŸ¥æœåŠ¡

é—®é¢˜ï¼šä¸€ä¸ªè¯·æ±‚è°ƒç”¨é“¾è·¯å¤æ‚ï¼Œé—®é¢˜å®šä½å›°éš¾
```

**ğŸ’¡ é“¾è·¯è¿½è¸ªè§£å†³çš„é—®é¢˜**
- **æ€§èƒ½ç“¶é¢ˆå®šä½**ï¼šå“ªä¸ªæœåŠ¡æ‹–æ…¢äº†æ•´ä½“å“åº”
- **é”™è¯¯æ ¹å› åˆ†æ**ï¼šé—®é¢˜å‡ºç°åœ¨è°ƒç”¨é“¾çš„å“ªä¸€ç¯
- **ä¾èµ–å…³ç³»æ¢³ç†**ï¼šæœåŠ¡é—´è°ƒç”¨å…³ç³»å¯è§†åŒ–
- **å®¹é‡è§„åˆ’ä¾æ®**ï¼šåŸºäºå®é™…è°ƒç”¨é‡åšèµ„æºè§„åˆ’

### 7.2 OpenTelemetryæ ‡å‡†åŒ–é‡‡é›†


**ğŸ”¸ OpenTelemetryæ¦‚è¿°**
- **å®šä¹‰**ï¼šäº‘åŸç”Ÿå¯è§‚æµ‹æ€§çš„ç»Ÿä¸€æ ‡å‡†
- **ç»„æˆ**ï¼šTraceï¼ˆé“¾è·¯ï¼‰+ Metricsï¼ˆæŒ‡æ ‡ï¼‰+ Logsï¼ˆæ—¥å¿—ï¼‰
- **ä¼˜åŠ¿**ï¼šå‚å•†ä¸­ç«‹ï¼Œé¿å…ä¾›åº”å•†é”å®š
- **æ”¯æŒ**ï¼šä¸»æµç¼–ç¨‹è¯­è¨€éƒ½æœ‰SDK

```yaml
# otel-collectoré…ç½®ç¤ºä¾‹
apiVersion: v1
kind: ConfigMap
metadata:
  name: otel-collector-config
data:
  config.yaml: |
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
    
    processors:
      batch:
        timeout: 1s
        send_batch_size: 1024
    
    exporters:
      jaeger:
        endpoint: jaeger-collector:14250
        tls:
          insecure: true
    
    service:
      pipelines:
        traces:
          receivers: [otlp]
          processors: [batch]
          exporters: [jaeger]
```

### 7.3 åº”ç”¨ä»£ç é›†æˆè¿½è¸ª


```python
# Pythonåº”ç”¨é›†æˆç¤ºä¾‹
from opentelemetry import trace
from opentelemetry.exporter.jaeger.thrift import JaegerExporter
from opentelemetry.sdk.trace import TracerProvider
from opentelemetry.sdk.trace.export import BatchSpanProcessor

# é…ç½®è¿½è¸ª
trace.set_tracer_provider(TracerProvider())
tracer = trace.get_tracer(__name__)

jaeger_exporter = JaegerExporter(
    agent_host_name="jaeger-agent",
    agent_port=6831,
)

trace.get_tracer_provider().add_span_processor(
    BatchSpanProcessor(jaeger_exporter)
)

# åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨
@app.route('/api/users/<user_id>')
def get_user(user_id):
    with tracer.start_as_current_span("get_user") as span:
        span.set_attribute("user.id", user_id)
        # ä¸šåŠ¡é€»è¾‘
        return {"user": user_data}
```

---

## 8. ğŸ“Š ç›‘æ§æ•°æ®å¯è§†åŒ–Grafana


### 8.1 Grafanaä»ªè¡¨ç›˜è®¾è®¡åŸåˆ™


**ğŸ¯ ä¼˜ç§€ä»ªè¡¨ç›˜çš„ç‰¹å¾**
```
è®¾è®¡åŸåˆ™ï¼š
â”Œâ”€ 5ç§’åŸåˆ™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ 5ç§’å†…çœ‹æ‡‚ç³»ç»ŸçŠ¶æ€      â”‚
â”‚ â€¢ å¼‚å¸¸é—®é¢˜ä¸€çœ¼å‘ç°       â”‚
â”‚ â€¢ å…³é”®æŒ‡æ ‡çªå‡ºæ˜¾ç¤º       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¸ƒå±€åŸåˆ™ï¼š
â€¢ ä¸Šæ–¹ï¼šæ•´ä½“çŠ¶æ€æ¦‚è§ˆ
â€¢ ä¸­é—´ï¼šå…³é”®ä¸šåŠ¡æŒ‡æ ‡
â€¢ ä¸‹æ–¹ï¼šè¯¦ç»†æŠ€æœ¯æŒ‡æ ‡
```

### 8.2 å¿…å¤‡ç›‘æ§ä»ªè¡¨ç›˜


**ğŸ·ï¸ é›†ç¾¤çº§åˆ«ä»ªè¡¨ç›˜**
- **Cluster Overview**ï¼šé›†ç¾¤æ•´ä½“å¥åº·çŠ¶æ€
- **Node Exporter Full**ï¼šèŠ‚ç‚¹è¯¦ç»†èµ„æºç›‘æ§
- **Kubernetes Capacity Planning**ï¼šå®¹é‡è§„åˆ’åˆ†æ

**ğŸ·ï¸ åº”ç”¨çº§åˆ«ä»ªè¡¨ç›˜**
- **Application Performance**ï¼šåº”ç”¨æ€§èƒ½ç›‘æ§
- **JVM Overview**ï¼šJavaåº”ç”¨JVMç›‘æ§
- **Database Performance**ï¼šæ•°æ®åº“æ€§èƒ½ç›‘æ§

### 8.3 è‡ªå®šä¹‰ä»ªè¡¨ç›˜é…ç½®


```json
{
  "dashboard": {
    "title": "K8s Podç›‘æ§",
    "panels": [
      {
        "title": "Pod CPUä½¿ç”¨ç‡",
        "type": "stat",
        "targets": [
          {
            "expr": "rate(container_cpu_usage_seconds_total{pod=~\"$pod\"}[5m]) * 100",
            "legendFormat": "{{pod}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 70},
                {"color": "red", "value": 90}
              ]
            }
          }
        }
      }
    ]
  }
}
```

**ğŸ“Š å…³é”®å¯è§†åŒ–ç»„ä»¶**
- **Single Stat**ï¼šå•ä¸€æŒ‡æ ‡å¤§å±æ˜¾ç¤º
- **Graph**ï¼šæ—¶é—´åºåˆ—è¶‹åŠ¿å›¾
- **Heatmap**ï¼šçƒ­åŠ›å›¾æ˜¾ç¤ºåˆ†å¸ƒ
- **Table**ï¼šè¡¨æ ¼æ˜¾ç¤ºè¯¦ç»†æ•°æ®
- **Alert List**ï¼šå‘Šè­¦ä¿¡æ¯åˆ—è¡¨

---

## 9. ğŸ” æ—¥å¿—èšåˆä¸æœç´¢åˆ†æ


### 9.1 ELK/EFKæŠ€æœ¯æ ˆ


**ğŸ—ï¸ æ—¥å¿—å¤„ç†æµæ°´çº¿**
```
æ—¥å¿—å¤„ç†æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨Pod   â”‚â”€â”€â”€â–¶â”‚ Fluent Bit  â”‚â”€â”€â”€â–¶â”‚Elasticsearchâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                   â”‚
                          â–¼                   â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   Fluentd   â”‚    â”‚   Kibana    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»„ä»¶ä½œç”¨ï¼š
â€¢ Fluent Bitï¼šè½»é‡çº§æ—¥å¿—æ”¶é›†
â€¢ Fluentdï¼šæ—¥å¿—å¤„ç†å’Œè·¯ç”±  
â€¢ Elasticsearchï¼šæ—¥å¿—å­˜å‚¨å’Œç´¢å¼•
â€¢ Kibanaï¼šæ—¥å¿—æŸ¥è¯¢å’Œå¯è§†åŒ–
```

### 9.2 æ—¥å¿—ç»“æ„åŒ–å¤„ç†


**ğŸ”§ æ—¥å¿—æ ¼å¼æ ‡å‡†åŒ–**
```yaml
# Fluentdå¤„ç†é…ç½®
<filter kubernetes.**>
  @type record_transformer
  <record>
    hostname ${hostname}
    timestamp ${time}
    level ${record['level'] || 'INFO'}
    message ${record['log']}
    pod_name ${record['kubernetes']['pod_name']}
    namespace ${record['kubernetes']['namespace_name']}
    container ${record['kubernetes']['container_name']}
  </record>
</filter>
```

**ğŸ“Š æ—¥å¿—åˆ†ç±»ç­–ç•¥**
- **åº”ç”¨æ—¥å¿—**ï¼šä¸šåŠ¡é€»è¾‘ç›¸å…³çš„æ—¥å¿—
- **è®¿é—®æ—¥å¿—**ï¼šHTTPè¯·æ±‚è®¿é—®è®°å½•
- **é”™è¯¯æ—¥å¿—**ï¼šå¼‚å¸¸å’Œé”™è¯¯ä¿¡æ¯
- **å®¡è®¡æ—¥å¿—**ï¼šå®‰å…¨å’Œåˆè§„ç›¸å…³æ“ä½œ
- **ç³»ç»Ÿæ—¥å¿—**ï¼šåŸºç¡€è®¾æ–½è¿è¡Œæ—¥å¿—

### 9.3 é«˜æ•ˆæ—¥å¿—æœç´¢æŠ€å·§


```bash
# Kibanaæœç´¢è¯­æ³•ç¤ºä¾‹

# åŸºç¡€æœç´¢
kubernetes.namespace_name: "production"
level: "ERROR"
message: "database connection failed"

# æ—¶é—´èŒƒå›´æœç´¢  
@timestamp: [now-1h TO now]

# å¤åˆæ¡ä»¶æœç´¢
kubernetes.namespace_name: "production" AND level: "ERROR" AND @timestamp: [now-15m TO now]

# é€šé…ç¬¦æœç´¢
message: "timeout*" OR message: "*connection*"

# æ­£åˆ™è¡¨è¾¾å¼æœç´¢
message: /HTTP [4-5]\d\d/
```

**ğŸ’¡ æœç´¢ä¼˜åŒ–å»ºè®®**
- **ä½¿ç”¨ç´¢å¼•**ï¼šåŸºäºæ—¶é—´å’Œæ ‡ç­¾å»ºç«‹åˆç†ç´¢å¼•
- **å­—æ®µæ˜ å°„**ï¼šä¸ºé‡è¦å­—æ®µè®¾ç½®æ­£ç¡®çš„æ•°æ®ç±»å‹
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šå®šæœŸæ¸…ç†è¿‡æœŸæ—¥å¿—æ•°æ®
- **åˆ†ç‰‡ç­–ç•¥**ï¼šæ ¹æ®æ—¥å¿—é‡åˆç†è®¾ç½®åˆ†ç‰‡æ•°

---

## 10. âš ï¸ ç›‘æ§å‘Šè­¦è§„åˆ™é…ç½®


### 10.1 å‘Šè­¦è§„åˆ™è®¾è®¡åŸåˆ™


**ğŸ¯ é¿å…å‘Šè­¦ç–²åŠ³**
```
å‘Šè­¦åˆ†çº§ç­–ç•¥ï¼š
â”Œâ”€ Critical â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ ç³»ç»Ÿä¸å¯ç”¨               â”‚
â”‚ â€¢ æ•°æ®ä¸¢å¤±é£é™©             â”‚
â”‚ â€¢ ç«‹å³å“åº”ï¼ˆ5åˆ†é’Ÿå†…ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€ Warning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
â”‚ â€¢ æ€§èƒ½ä¸‹é™                 â”‚
â”‚ â€¢ èµ„æºä½¿ç”¨ç‡é«˜             â”‚  
â”‚ â€¢ 1å°æ—¶å†…å¤„ç†              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€ Info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ é…ç½®å˜æ›´                 â”‚
â”‚ â€¢ æ­£å¸¸è¿ç»´æ“ä½œ             â”‚
â”‚ â€¢ è®°å½•å³å¯ï¼Œæ— éœ€ç«‹å³å¤„ç†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 æ ¸å¿ƒå‘Šè­¦è§„åˆ™é…ç½®


```yaml
# prometheus-alerts.yaml
groups:
- name: kubernetes-resources
  rules:
  # èŠ‚ç‚¹CPUä½¿ç”¨ç‡è¿‡é«˜
  - alert: NodeHighCPUUsage
    expr: (1 - (rate(node_cpu_seconds_total{mode="idle"}[5m]))) * 100 > 85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "èŠ‚ç‚¹ {{ $labels.instance }} CPUä½¿ç”¨ç‡è¿‡é«˜"
      description: "CPUä½¿ç”¨ç‡å·²è¾¾åˆ° {{ $value }}%ï¼ŒæŒç»­5åˆ†é’Ÿ"
      
  # Podå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜  
  - alert: PodHighMemoryUsage
    expr: container_memory_usage_bytes / container_spec_memory_limit_bytes * 100 > 90
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "Pod {{ $labels.pod }} å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
      description: "å†…å­˜ä½¿ç”¨ç‡ {{ $value }}%ï¼Œå¯èƒ½å‘ç”ŸOOM"
      
  # Podé‡å¯é¢‘ç¹
  - alert: PodCrashLooping  
    expr: rate(kube_pod_container_status_restarts_total[15m]) > 0.1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Pod {{ $labels.pod }} é¢‘ç¹é‡å¯"
      description: "è¿‡å»15åˆ†é’Ÿé‡å¯ç‡: {{ $value }}"
```

### 10.3 AlertManageré€šçŸ¥é…ç½®


```yaml
# alertmanager.yml
global:
  smtp_smarthost: 'smtp.company.com:587'
  smtp_from: 'k8s-alert@company.com'
  smtp_auth_username: 'k8s-alert@company.com'
  smtp_auth_password: 'password'

route:
  group_by: ['alertname']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  receiver: 'web.hook'
  routes:
  - match:
      severity: critical
    receiver: 'critical-alerts'
    
receivers:
- name: 'web.hook'
  webhook_configs:
  - url: 'http://webhook.company.com/alerts'
    
- name: 'critical-alerts'
  email_configs:
  - to: 'oncall@company.com'
    subject: 'ğŸš¨ K8s Critical Alert: {{ .GroupLabels.alertname }}'
    body: |
      å‘Šè­¦è¯¦æƒ…:
      {{ range .Alerts }}
      - å‘Šè­¦: {{ .Annotations.summary }}
      - æè¿°: {{ .Annotations.description }}
      - æ—¶é—´: {{ .StartsAt }}
      {{ end }}
  webhook_configs:
  - url: 'http://slack-webhook.company.com/critical'
```

**ğŸ“± å¤šæ¸ é“é€šçŸ¥é›†æˆ**
- **é‚®ä»¶é€šçŸ¥**ï¼šè¯¦ç»†å‘Šè­¦ä¿¡æ¯ï¼Œé€‚åˆéç´§æ€¥å‘Šè­¦
- **çŸ­ä¿¡é€šçŸ¥**ï¼šå…³é”®å‘Šè­¦ç«‹å³é€šçŸ¥
- **Slack/ä¼ä¸šå¾®ä¿¡**ï¼šå›¢é˜Ÿåä½œå¹³å°é›†æˆ
- **PagerDuty**ï¼šä¸“ä¸šçš„äº‹ä»¶å“åº”å¹³å°
- **Webhook**ï¼šè‡ªå®šä¹‰é€šçŸ¥å¤„ç†é€»è¾‘

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç›‘æ§ä¸‰å±‚æ¶æ„ï¼šåŸºç¡€è®¾æ–½ + å®¹å™¨ + åº”ç”¨å±‚ç›‘æ§
ğŸ”¸ å››ä¸ªé»„é‡‘æŒ‡æ ‡ï¼šå»¶è¿Ÿã€ååé‡ã€é”™è¯¯ç‡ã€é¥±å’Œåº¦
ğŸ”¸ Metrics Serverï¼šK8sèµ„æºæŒ‡æ ‡æ”¶é›†çš„åŸºç¡€ç»„ä»¶
ğŸ”¸ Prometheusæ ˆï¼šå®Œæ•´ç›‘æ§è§£å†³æ–¹æ¡ˆçš„æ ‡å‡†é€‰æ‹©
ğŸ”¸ æ—¥å¿—æ”¶é›†æ¶æ„ï¼šç»Ÿä¸€æ”¶é›†ã€é›†ä¸­å­˜å‚¨ã€ç»“æ„åŒ–åˆ†æ
ğŸ”¸ åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼šå¾®æœåŠ¡ç¯å¢ƒä¸‹çš„æ€§èƒ½åˆ†æåˆ©å™¨
ğŸ”¸ å¯è§†åŒ–ä»ªè¡¨ç›˜ï¼šæ•°æ®çš„ç›´è§‚å±•ç¤ºå’Œå¿«é€Ÿåˆ†æ
ğŸ”¸ å‘Šè­¦è§„åˆ™é…ç½®ï¼šåŠæ—¶å‘ç°é—®é¢˜ã€é¿å…å‘Šè­¦ç–²åŠ³
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§ä¸æ˜¯ä¸‡èƒ½è¯ï¼Œä½†æ²¡æœ‰ç›‘æ§ä¸‡ä¸‡ä¸èƒ½**
```
ç›‘æ§çš„ä»·å€¼ï¼š
â€¢ é¢„é˜²é—®é¢˜ï¼šé€šè¿‡è¶‹åŠ¿åˆ†ææå‰å‘ç°æ½œåœ¨é—®é¢˜
â€¢ å¿«é€Ÿå®šä½ï¼šé—®é¢˜å‘ç”Ÿæ—¶å¿«é€Ÿæ‰¾åˆ°æ ¹æœ¬åŸå› 
â€¢ æ€§èƒ½ä¼˜åŒ–ï¼šåŸºäºæ•°æ®åˆ†æè¿›è¡Œç³»ç»Ÿè°ƒä¼˜
â€¢ å®¹é‡è§„åˆ’ï¼šä¸ºèµ„æºæ‰©å±•æä¾›å†³ç­–ä¾æ®
```

**ğŸ”¹ æ—¥å¿—å’Œç›‘æ§æ˜¯äº’è¡¥çš„ï¼Œä¸æ˜¯é‡å¤çš„**
```
ç›‘æ§ï¼šå‘Šè¯‰ä½ "å‘ç”Ÿäº†ä»€ä¹ˆ"
æ—¥å¿—ï¼šå‘Šè¯‰ä½ "ä¸ºä»€ä¹ˆå‘ç”Ÿ"

ç»“åˆä½¿ç”¨æ‰èƒ½å®Œæ•´äº†è§£ç³»ç»ŸçŠ¶æ€
```

**ğŸ”¹ å‘Šè­¦è§„åˆ™è®¾è®¡éœ€è¦å¹³è¡¡**
```
è¿‡äºæ•æ„Ÿï¼šå‘Šè­¦ç–²åŠ³ï¼Œé‡è¦å‘Šè­¦è¢«å¿½ç•¥
è¿‡äºè¿Ÿé’ï¼šé—®é¢˜å‘ç°å¤ªæ™šï¼Œå½±å“ç”¨æˆ·

æœ€ä½³å®è·µï¼š
â€¢ åŸºäºä¸šåŠ¡å½±å“è®¾è®¡å‘Šè­¦
â€¢ åˆ†çº§å¤„ç†ä¸åŒä¸¥é‡ç¨‹åº¦
â€¢ å®šæœŸå›é¡¾å’Œä¼˜åŒ–å‘Šè­¦è§„åˆ™
```

### 11.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ç›‘æ§ä½“ç³»å»ºè®¾è·¯å¾„**
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç›‘æ§
â€¢ éƒ¨ç½²Metrics Server
â€¢ é…ç½®åŸºæœ¬çš„èµ„æºç›‘æ§
â€¢ å»ºç«‹ç®€å•çš„å‘Šè­¦è§„åˆ™

ç¬¬äºŒé˜¶æ®µï¼šå®Œå–„ç›‘æ§
â€¢ éƒ¨ç½²Prometheusç›‘æ§æ ˆ
â€¢ é…ç½®åº”ç”¨å±‚ç›‘æ§
â€¢ å»ºç«‹æ—¥å¿—æ”¶é›†ç³»ç»Ÿ

ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç›‘æ§
â€¢ é›†æˆAPMåº”ç”¨æ€§èƒ½ç›‘æ§
â€¢ éƒ¨ç½²åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
â€¢ å»ºç«‹å®Œæ•´çš„å¯è§‚æµ‹æ€§ä½“ç³»
```

**ğŸ”§ å®æ–½å»ºè®®**
- **ä»ç®€å•å¼€å§‹**ï¼šå…ˆå»ºç«‹åŸºç¡€ç›‘æ§ï¼Œå†é€æ­¥å®Œå–„
- **æ ‡å‡†åŒ–é…ç½®**ï¼šåˆ¶å®šç»Ÿä¸€çš„ç›‘æ§æ ‡å‡†å’Œæœ€ä½³å®è·µ
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šåˆ©ç”¨ç›‘æ§æ•°æ®å®ç°è‡ªåŠ¨åŒ–è¿ç»´
- **æŒç»­ä¼˜åŒ–**ï¼šå®šæœŸå›é¡¾ç›‘æ§æ•ˆæœï¼ŒæŒç»­æ”¹è¿›

### 11.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**ğŸ“Š æ€§èƒ½é—®é¢˜**
```
é—®é¢˜ï¼šç›‘æ§ç³»ç»Ÿæœ¬èº«æ¶ˆè€—è¿‡å¤šèµ„æº
è§£å†³ï¼š
â€¢ åˆç†è®¾ç½®é‡‡é›†é¢‘ç‡
â€¢ ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨è¿‡æ»¤ä¸å¿…è¦çš„æŒ‡æ ‡
â€¢ å®šæœŸæ¸…ç†å†å²æ•°æ®
â€¢ ä½¿ç”¨è½»é‡çº§æ”¶é›†å™¨ï¼ˆå¦‚Fluent Bitï¼‰
```

**ğŸ” æ•°æ®è´¨é‡é—®é¢˜**
```
é—®é¢˜ï¼šç›‘æ§æ•°æ®ä¸å‡†ç¡®æˆ–ä¸¢å¤±
è§£å†³ï¼š
â€¢ ç¡®ä¿æ—¶é—´åŒæ­¥
â€¢ é…ç½®åˆç†çš„é‡è¯•å’Œç¼“å­˜æœºåˆ¶
â€¢ ç›‘æ§ç›‘æ§ç³»ç»Ÿæœ¬èº«çš„å¥åº·çŠ¶æ€
â€¢ å»ºç«‹æ•°æ®è´¨é‡æ£€æŸ¥æœºåˆ¶
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†**ï¼š
- K8sç›‘æ§æ˜¯åˆ†å±‚çš„ï¼šåŸºç¡€è®¾æ–½ã€å®¹å™¨ã€åº”ç”¨å±‚
- æ—¥å¿—å’ŒæŒ‡æ ‡äº’è¡¥ï¼šæŒ‡æ ‡çœ‹è¶‹åŠ¿ï¼Œæ—¥å¿—æŸ¥åŸå› 
- å‘Šè­¦è¦åˆ†çº§ï¼šCriticalç«‹å³å“åº”ï¼ŒWarningè®¡åˆ’å¤„ç†
- å¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±ï¼šMetrics + Logs + Traces
- ç›‘æ§ç³»ç»Ÿè¦ç›‘æ§ï¼šç¡®ä¿ç›‘æ§æœ¬èº«çš„å¯é æ€§