---
title: 6ã€ConfigMapé…ç½®ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ConfigMapæ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨](#1-configmapæ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨)
2. [ConfigMapåˆ›å»ºä¸æ•°æ®å­˜å‚¨](#2-configmapåˆ›å»ºä¸æ•°æ®å­˜å‚¨)
3. [ç¯å¢ƒå˜é‡æ–¹å¼é…ç½®æ³¨å…¥](#3-ç¯å¢ƒå˜é‡æ–¹å¼é…ç½®æ³¨å…¥)
4. [VolumeæŒ‚è½½é…ç½®æ–‡ä»¶](#4-volumeæŒ‚è½½é…ç½®æ–‡ä»¶)
5. [é…ç½®çƒ­æ›´æ–°ä¸é‡è½½æœºåˆ¶](#5-é…ç½®çƒ­æ›´æ–°ä¸é‡è½½æœºåˆ¶)
6. [é…ç½®æ¨¡æ¿åŒ–ä¸å‚æ•°æ›¿æ¢](#6-é…ç½®æ¨¡æ¿åŒ–ä¸å‚æ•°æ›¿æ¢)
7. [å¤šç¯å¢ƒé…ç½®ç®¡ç†ç­–ç•¥](#7-å¤šç¯å¢ƒé…ç½®ç®¡ç†ç­–ç•¥)
8. [é…ç½®éªŒè¯ä¸æ ¼å¼æ£€æŸ¥](#8-é…ç½®éªŒè¯ä¸æ ¼å¼æ£€æŸ¥)
9. [å¤§é…ç½®æ–‡ä»¶åˆ†å‰²ç®¡ç†](#9-å¤§é…ç½®æ–‡ä»¶åˆ†å‰²ç®¡ç†)
10. [é…ç½®ç‰ˆæœ¬æ§åˆ¶ä¸å›æ»š](#10-é…ç½®ç‰ˆæœ¬æ§åˆ¶ä¸å›æ»š)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—‚ï¸ ConfigMapæ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨


### 1.1 ä»€ä¹ˆæ˜¯ConfigMap


**é€šä¿—ç†è§£**ï¼š
ConfigMapå°±åƒä¸€ä¸ª"é…ç½®æ–‡ä»¶å¤¹"ï¼Œä¸“é—¨å­˜æ”¾åº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ã€‚æƒ³è±¡ä½ çš„åº”ç”¨æ˜¯ä¸€ä¸ªé¤å…ï¼ŒConfigMapå°±æ˜¯èœå•ã€ä»·æ ¼è¡¨ã€è¥ä¸šæ—¶é—´ç­‰é…ç½®ä¿¡æ¯çš„é›†åˆã€‚

**æ ¸å¿ƒä½œç”¨**ï¼š
```
é…ç½®ä¸ä»£ç åˆ†ç¦»ï¼š
åº”ç”¨ä»£ç  â†â†’ ConfigMapé…ç½®
   â†“              â†“
ä¸å˜çš„é€»è¾‘    å¯å˜çš„å‚æ•°

å¥½å¤„ï¼š
â€¢ ä¿®æ”¹é…ç½®ä¸ç”¨é‡æ–°æ‰“åŒ…é•œåƒ
â€¢ åŒä¸€é•œåƒé€‚é…ä¸åŒç¯å¢ƒ
â€¢ é…ç½®ç»Ÿä¸€ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶
```

### 1.2 ConfigMapè§£å†³çš„é—®é¢˜


**ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**ï¼š
- é…ç½®å†™æ­»åœ¨ä»£ç é‡Œï¼Œä¿®æ”¹è¦é‡æ–°éƒ¨ç½²
- ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒé…ç½®ï¼Œè¦ç»´æŠ¤å¤šä¸ªé•œåƒ
- é…ç½®åˆ†æ•£åœ¨å„å¤„ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†

**ConfigMapçš„ä¼˜åŠ¿**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¼€å‘ç¯å¢ƒ      â”‚    â”‚    ç”Ÿäº§ç¯å¢ƒ      â”‚
â”‚ ConfigMap-dev   â”‚    â”‚ ConfigMap-prod   â”‚
â”‚ â””â”€æ•°æ®åº“:test   â”‚    â”‚ â””â”€æ•°æ®åº“:prod    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åŒä¸€ä¸ªåº”ç”¨é•œåƒ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ConfigMapçš„æ•°æ®ç‰¹ç‚¹


**å­˜å‚¨é™åˆ¶**ï¼š
- å•ä¸ªConfigMapæœ€å¤§1MB
- é€‚åˆå­˜å‚¨é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡
- ä¸é€‚åˆå­˜å‚¨å¤§æ–‡ä»¶æˆ–äºŒè¿›åˆ¶æ•°æ®

**æ•°æ®æ ¼å¼**ï¼š
```
æ”¯æŒæ ¼å¼ï¼š
â€¢ é”®å€¼å¯¹ï¼škey=value
â€¢ é…ç½®æ–‡ä»¶ï¼šå®Œæ•´çš„é…ç½®æ–‡ä»¶å†…å®¹
â€¢ JSON/YAMLï¼šç»“æ„åŒ–é…ç½®æ•°æ®
```

---

## 2. ğŸ“ ConfigMapåˆ›å»ºä¸æ•°æ®å­˜å‚¨


### 2.1 å­—é¢é‡åˆ›å»ºæ–¹å¼


**åŸºç¡€è¯­æ³•**ï¼š
```bash
# åˆ›å»ºé”®å€¼å¯¹é…ç½®
kubectl create configmap app-config \
  --from-literal=database.host=mysql.example.com \
  --from-literal=database.port=3306 \
  --from-literal=debug.enabled=true
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```bash
# Webåº”ç”¨é…ç½®
kubectl create configmap web-config \
  --from-literal=server.port=8080 \
  --from-literal=log.level=INFO \
  --from-literal=cache.timeout=300
```

### 2.2 ä»æ–‡ä»¶åˆ›å»ºConfigMap


**å•ä¸ªé…ç½®æ–‡ä»¶**ï¼š
```bash
# ä»nginx.confæ–‡ä»¶åˆ›å»º
kubectl create configmap nginx-config --from-file=nginx.conf

# æŒ‡å®šé”®å
kubectl create configmap app-config --from-file=config=app.properties
```

**å¤šä¸ªæ–‡ä»¶åŒæ—¶åˆ›å»º**ï¼š
```bash
# ä»æ•´ä¸ªé…ç½®ç›®å½•åˆ›å»º
kubectl create configmap multi-config --from-file=./config-dir/
```

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**ï¼š
```properties
# app.properties
server.port=8080
database.url=jdbc:mysql://mysql:3306/app
database.username=appuser
logging.level=INFO
feature.cache.enabled=true
```

### 2.3 YAMLå£°æ˜å¼åˆ›å»º


**åŸºç¡€é…ç½®ç¤ºä¾‹**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: default
data:
  # ç®€å•é”®å€¼å¯¹
  database.host: "mysql.example.com"
  database.port: "3306"
  debug.enabled: "true"
  
  # å®Œæ•´é…ç½®æ–‡ä»¶
  app.properties: |
    server.port=8080
    database.url=jdbc:mysql://mysql:3306/app
    logging.level=INFO
    
  # JSONæ ¼å¼é…ç½®
  features.json: |
    {
      "cache": {
        "enabled": true,
        "ttl": 300
      },
      "logging": {
        "level": "INFO"
      }
    }
```

### 2.4 äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨


**binaryDataå­—æ®µ**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: binary-config
data:
  # æ–‡æœ¬æ•°æ®
  config.txt: "è¿™æ˜¯æ–‡æœ¬é…ç½®"
binaryData:
  # äºŒè¿›åˆ¶æ•°æ®ï¼ˆbase64ç¼–ç ï¼‰
  logo.png: iVBORw0KGgoAAAANSUhEUgAA...
```

---

## 3. ğŸ”§ ç¯å¢ƒå˜é‡æ–¹å¼é…ç½®æ³¨å…¥


### 3.1 å•ä¸ªé”®å€¼æ³¨å…¥


**åŸºç¡€ç”¨æ³•**ï¼š
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
spec:
  containers:
  - name: app
    image: nginx:1.20
    env:
    # ä»ConfigMapè·å–å•ä¸ªå€¼
    - name: DATABASE_HOST
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: database.host
    - name: DATABASE_PORT
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: database.port
```

**å®é™…åœºæ™¯åº”ç”¨**ï¼š
```yaml
# Webåº”ç”¨Podé…ç½®
spec:
  containers:
  - name: web-app
    image: myapp:1.0
    env:
    - name: SERVER_PORT
      valueFrom:
        configMapKeyRef:
          name: web-config
          key: server.port
    - name: LOG_LEVEL
      valueFrom:
        configMapKeyRef:
          name: web-config
          key: log.level
```

### 3.2 æ‰¹é‡ç¯å¢ƒå˜é‡æ³¨å…¥


**envFromå…¨é‡æ³¨å…¥**ï¼š
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
spec:
  containers:
  - name: app
    image: myapp:1.0
    envFrom:
    # å°†ConfigMapæ‰€æœ‰é”®å€¼å¯¹ä½œä¸ºç¯å¢ƒå˜é‡
    - configMapRef:
        name: app-config
    # æ·»åŠ å‰ç¼€é¿å…å†²çª
    - configMapRef:
        name: db-config
      prefix: DB_
```

**ç¯å¢ƒå˜é‡å‘½åè§„åˆ™**ï¼š
```
ConfigMapé”®åè½¬æ¢è§„åˆ™ï¼š
database.host â†’ DATABASE_HOST
server.port â†’ SERVER_PORT
log.level â†’ LOG_LEVEL

ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼š
database-host â†’ DATABASE_HOST  
cache.redis.host â†’ CACHE_REDIS_HOST
```

### 3.3 ç¯å¢ƒå˜é‡ä½¿ç”¨æœ€ä½³å®è·µ


**é…ç½®åˆ†ç±»ç®¡ç†**ï¼š
```yaml
# åº”ç”¨é…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  server.port: "8080"
  log.level: "INFO"

---
# æ•°æ®åº“é…ç½®  
apiVersion: v1
kind: ConfigMap
metadata:
  name: db-config
data:
  host: "mysql.example.com"
  port: "3306"
  database: "app_db"
```

**Deploymentä¸­çš„ä½¿ç”¨**ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web-app
  template:
    metadata:
      labels:
        app: web-app
    spec:
      containers:
      - name: web
        image: myapp:1.0
        envFrom:
        - configMapRef:
            name: app-config
        - configMapRef:
            name: db-config
            prefix: DB_
```

---

## 4. ğŸ“‚ VolumeæŒ‚è½½é…ç½®æ–‡ä»¶


### 4.1 åŸºç¡€æ–‡ä»¶æŒ‚è½½


**å®Œæ•´æ–‡ä»¶æŒ‚è½½**ï¼š
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
spec:
  containers:
  - name: nginx
    image: nginx:1.20
    volumeMounts:
    # å°†ConfigMapæŒ‚è½½ä¸ºæ–‡ä»¶
    - name: nginx-config
      mountPath: /etc/nginx/nginx.conf
      subPath: nginx.conf  # æŒ‚è½½ç‰¹å®šæ–‡ä»¶
  volumes:
  - name: nginx-config
    configMap:
      name: nginx-configmap
```

**ç›®å½•æŒ‚è½½æ–¹å¼**ï¼š
```yaml
spec:
  containers:
  - name: app
    image: myapp:1.0
    volumeMounts:
    # æŒ‚è½½åˆ°é…ç½®ç›®å½•
    - name: app-config
      mountPath: /app/config
  volumes:
  - name: app-config
    configMap:
      name: app-configmap
```

### 4.2 é€‰æ‹©æ€§æ–‡ä»¶æŒ‚è½½


**æŒ‚è½½éƒ¨åˆ†æ–‡ä»¶**ï¼š
```yaml
volumes:
- name: config-volume
  configMap:
    name: app-config
    items:  # åªæŒ‚è½½æŒ‡å®šçš„é”®
    - key: app.properties
      path: application.properties
    - key: log4j.xml
      path: logging/log4j.xml
```

**æ–‡ä»¶æƒé™è®¾ç½®**ï¼š
```yaml
volumes:
- name: config-volume
  configMap:
    name: app-config
    defaultMode: 0644  # è®¾ç½®æ–‡ä»¶æƒé™
    items:
    - key: script.sh
      path: startup.sh
      mode: 0755  # å¯æ‰§è¡Œæƒé™
```

### 4.3 å®é™…åº”ç”¨åœºæ™¯


**Nginxé…ç½®ç®¡ç†**ï¼š
```yaml
# nginx-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  nginx.conf: |
    events {
        worker_connections 1024;
    }
    http {
        server {
            listen 80;
            location / {
                proxy_pass http://backend-service:8080;
                proxy_set_header Host $host;
            }
        }
    }

---
# nginx-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.20
        volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx/nginx.conf
          subPath: nginx.conf
      volumes:
      - name: nginx-config
        configMap:
          name: nginx-config
```

**åº”ç”¨å¤šé…ç½®æ–‡ä»¶ç®¡ç†**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-configs
data:
  application.yml: |
    server:
      port: 8080
    spring:
      datasource:
        url: jdbc:mysql://mysql:3306/app
        username: ${DB_USERNAME}
        password: ${DB_PASSWORD}
        
  logback.xml: |
    <configuration>
        <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
            <encoder>
                <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
            </encoder>
        </appender>
        <root level="INFO">
            <appender-ref ref="STDOUT" />
        </root>
    </configuration>
```

---

## 5. ğŸ”„ é…ç½®çƒ­æ›´æ–°ä¸é‡è½½æœºåˆ¶


### 5.1 ConfigMapè‡ªåŠ¨æ›´æ–°


**æ›´æ–°ä¼ æ’­æœºåˆ¶**ï¼š
```
ConfigMapæ›´æ–°æµç¨‹ï¼š
1. ä¿®æ”¹ConfigMap â†’ kubectl apply
2. kubeletæ£€æµ‹å˜åŒ– â†’ 10s-1minå»¶è¿Ÿ
3. æ›´æ–°æŒ‚è½½æ–‡ä»¶ â†’ å®¹å™¨å†…æ–‡ä»¶æ”¹å˜
4. åº”ç”¨æ£€æµ‹æ–‡ä»¶å˜åŒ– â†’ é‡æ–°åŠ è½½é…ç½®
```

**æ–‡ä»¶ç›‘æ§ç¤ºä¾‹**ï¼š
```yaml
# æ”¯æŒçƒ­æ›´æ–°çš„åº”ç”¨é…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: hot-reload-config
data:
  config.properties: |
    # åº”ç”¨ä¼šç›‘æ§æ­¤æ–‡ä»¶å˜åŒ–
    cache.size=100
    log.level=INFO
    feature.enabled=true
```

### 5.2 åº”ç”¨é‡è½½ç­–ç•¥


**æ»šåŠ¨æ›´æ–°è§¦å‘**ï¼š
```yaml
# åœ¨Deploymentä¸­æ·»åŠ é…ç½®ç‰ˆæœ¬æ³¨è§£
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app
spec:
  template:
    metadata:
      annotations:
        # é…ç½®ç‰ˆæœ¬å˜æ›´è§¦å‘é‡æ–°éƒ¨ç½²
        configmap/version: "v1.2.3"
    spec:
      containers:
      - name: app
        image: myapp:1.0
```

**è‡ªåŠ¨é‡å¯ç­–ç•¥**ï¼š
```bash
# ä¿®æ”¹ConfigMapåè§¦å‘æ»šåŠ¨æ›´æ–°
kubectl patch deployment app \
  -p '{"spec":{"template":{"metadata":{"annotations":{"configmap-version":"'$(date +%s)'"}}}}}'
```

### 5.3 é…ç½®å˜æ›´æ£€æµ‹


**æ–‡ä»¶ç›‘æ§æ–¹æ¡ˆ**ï¼š
```yaml
# ä½¿ç”¨initContaineræ£€æŸ¥é…ç½®å˜åŒ–
spec:
  initContainers:
  - name: config-watcher
    image: busybox
    command: ['sh', '-c', 'echo "Config updated at $(date)" > /tmp/config-timestamp']
    volumeMounts:
    - name: config-volume
      mountPath: /app/config
  containers:
  - name: app
    image: myapp:1.0
    # åº”ç”¨å†…å®ç°é…ç½®æ–‡ä»¶ç›‘æ§
```

**é…ç½®æ ¡éªŒæœºåˆ¶**ï¼š
```yaml
# é…ç½®éªŒè¯ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: config-validator
data:
  validate.sh: |
    #!/bin/bash
    # éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
    if ! nginx -t -c /app/config/nginx.conf; then
        echo "Invalid nginx config"
        exit 1
    fi
    echo "Config validation passed"
```

---

## 6. ğŸ”§ é…ç½®æ¨¡æ¿åŒ–ä¸å‚æ•°æ›¿æ¢


### 6.1 é…ç½®æ¨¡æ¿è®¾è®¡


**åŸºç¡€æ¨¡æ¿ç¤ºä¾‹**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-template
data:
  config.template: |
    server:
      port: ${SERVER_PORT:-8080}
      host: ${SERVER_HOST:-0.0.0.0}
    database:
      url: jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}
      username: ${DB_USERNAME}
      password: ${DB_PASSWORD}
    redis:
      host: ${REDIS_HOST:-redis}
      port: ${REDIS_PORT:-6379}
```

**ç¯å¢ƒç‰¹å®šé…ç½®**ï¼š
```yaml
# å¼€å‘ç¯å¢ƒé…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: dev-env-vars
data:
  SERVER_PORT: "8080"
  DB_HOST: "mysql-dev"
  DB_NAME: "app_dev"
  REDIS_HOST: "redis-dev"

---
# ç”Ÿäº§ç¯å¢ƒé…ç½®  
apiVersion: v1
kind: ConfigMap
metadata:
  name: prod-env-vars
data:
  SERVER_PORT: "80"
  DB_HOST: "mysql-cluster"
  DB_NAME: "app_prod"
  REDIS_HOST: "redis-cluster"
```

### 6.2 æ¨¡æ¿å¤„ç†å®ç°


**initContaineræ¨¡æ¿å¤„ç†**ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: template-app
spec:
  template:
    spec:
      initContainers:
      # é…ç½®æ¨¡æ¿å¤„ç†å®¹å™¨
      - name: config-processor
        image: busybox
        command:
        - sh
        - -c
        - |
          # ä½¿ç”¨envsubstè¿›è¡Œæ¨¡æ¿æ›¿æ¢
          envsubst < /templates/config.template > /processed/config.yml
        env:
        - name: SERVER_PORT
          value: "8080"
        - name: DB_HOST
          value: "mysql"
        volumeMounts:
        - name: template-config
          mountPath: /templates
        - name: processed-config
          mountPath: /processed
      
      containers:
      - name: app
        image: myapp:1.0
        volumeMounts:
        - name: processed-config
          mountPath: /app/config
          
      volumes:
      - name: template-config
        configMap:
          name: app-template
      - name: processed-config
        emptyDir: {}
```

### 6.3 é…ç½®ç»§æ‰¿ä¸è¦†ç›–


**åˆ†å±‚é…ç½®ç®¡ç†**ï¼š
```yaml
# åŸºç¡€é…ç½® - é€šç”¨è®¾ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: base-config
data:
  logging.level: INFO
  cache.enabled: "true"
  timeout.connect: "5000"

---
# ç¯å¢ƒç‰¹å®šé…ç½® - è¦†ç›–éƒ¨åˆ†è®¾ç½®
apiVersion: v1
kind: ConfigMap  
metadata:
  name: env-config
data:
  logging.level: DEBUG  # è¦†ç›–åŸºç¡€é…ç½®
  database.pool.size: "20"  # æ–°å¢é…ç½®
```

**é…ç½®åˆå¹¶ç­–ç•¥**ï¼š
```yaml
spec:
  containers:
  - name: app
    image: myapp:1.0
    envFrom:
    # å…ˆåŠ è½½åŸºç¡€é…ç½®
    - configMapRef:
        name: base-config
    # ååŠ è½½çš„é…ç½®ä¼šè¦†ç›–å‰é¢çš„
    - configMapRef:
        name: env-config
```

---

## 7. ğŸŒ å¤šç¯å¢ƒé…ç½®ç®¡ç†ç­–ç•¥


### 7.1 å‘½åç©ºé—´éš”ç¦»


**ç¯å¢ƒéš”ç¦»è®¾è®¡**ï¼š
```
å¤šç¯å¢ƒæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Namespace   â”‚  â”‚ Namespace   â”‚  â”‚ Namespace   â”‚
â”‚   dev       â”‚  â”‚   test      â”‚  â”‚   prod      â”‚
â”‚             â”‚  â”‚             â”‚  â”‚             â”‚
â”‚ ConfigMap   â”‚  â”‚ ConfigMap   â”‚  â”‚ ConfigMap   â”‚
â”‚ app-config  â”‚  â”‚ app-config  â”‚  â”‚ app-config  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¼€å‘ç¯å¢ƒé…ç½®**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: dev
data:
  database.url: "jdbc:mysql://mysql-dev:3306/app_dev"
  redis.url: "redis://redis-dev:6379"
  log.level: "DEBUG"
  feature.debug: "true"
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: prod
data:
  database.url: "jdbc:mysql://mysql-prod:3306/app_prod"
  redis.url: "redis://redis-cluster:6379"
  log.level: "INFO"
  feature.debug: "false"
```

### 7.2 æ ‡ç­¾é€‰æ‹©å™¨ç®¡ç†


**ç¯å¢ƒæ ‡ç­¾ç­–ç•¥**ï¼š
```yaml
# å¼€å‘ç¯å¢ƒé…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-dev
  labels:
    app: myapp
    env: dev
    version: v1.0
data:
  server.port: "8080"
  database.host: "mysql-dev"

---
# ç”Ÿäº§ç¯å¢ƒé…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-prod
  labels:
    app: myapp
    env: prod
    version: v1.0
data:
  server.port: "80"
  database.host: "mysql-cluster"
```

### 7.3 ConfigMapç®¡ç†å·¥å…·


**æ‰¹é‡ç®¡ç†è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å¤šç¯å¢ƒé…ç½®éƒ¨ç½²è„šæœ¬

deploy_config() {
    local env=$1
    local namespace=$2
    
    # ç”Ÿæˆç¯å¢ƒç‰¹å®šé…ç½®
    envsubst < config-template.yaml | \
    sed "s/{{ENV}}/${env}/g" | \
    kubectl apply -n ${namespace} -f -
}

# éƒ¨ç½²åˆ°å„ç¯å¢ƒ
deploy_config "dev" "development"
deploy_config "test" "testing" 
deploy_config "prod" "production"
```

**é…ç½®å·®å¼‚å¯¹æ¯”**ï¼š
```bash
# å¯¹æ¯”ä¸åŒç¯å¢ƒé…ç½®å·®å¼‚
kubectl get configmap app-config -n dev -o yaml > dev-config.yaml
kubectl get configmap app-config -n prod -o yaml > prod-config.yaml
diff dev-config.yaml prod-config.yaml
```

---

## 8. âœ… é…ç½®éªŒè¯ä¸æ ¼å¼æ£€æŸ¥


### 8.1 é…ç½®æ ¼å¼éªŒè¯


**YAMLæ ¼å¼éªŒè¯**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: validated-config
  annotations:
    # é…ç½®schemaéªŒè¯
    config.kubernetes.io/schema: "app-config-v1"
data:
  application.yml: |
    # ç¬¦åˆschemaçš„é…ç½®
    server:
      port: 8080        # å¿…é¡»æ˜¯æ•°å­—
      host: "0.0.0.0"   # å¿…é¡»æ˜¯æœ‰æ•ˆIP
    database:
      url: "jdbc:mysql://mysql:3306/app"  # å¿…é¡»æ˜¯URLæ ¼å¼
      pool:
        min: 5          # æ•°å­—ç±»å‹
        max: 20         # æ•°å­—ç±»å‹ï¼Œä¸” > min
```

**JSON SchemaéªŒè¯**ï¼š
```json
{
  "type": "object",
  "properties": {
    "server": {
      "type": "object",
      "properties": {
        "port": {"type": "number", "minimum": 1, "maximum": 65535},
        "host": {"type": "string", "format": "ipv4"}
      },
      "required": ["port", "host"]
    }
  }
}
```

### 8.2 é…ç½®é¢„éªŒè¯


**éªŒè¯initContainer**ï¼š
```yaml
spec:
  initContainers:
  - name: config-validator
    image: yq:latest
    command:
    - sh
    - -c
    - |
      # éªŒè¯YAMLæ ¼å¼
      if ! yq eval '.' /config/application.yml > /dev/null; then
        echo "Invalid YAML format"
        exit 1
      fi
      
      # éªŒè¯å¿…éœ€å­—æ®µ
      if [ "$(yq eval '.server.port' /config/application.yml)" = "null" ]; then
        echo "Missing required field: server.port"
        exit 1
      fi
      
      echo "Configuration validation passed"
    volumeMounts:
    - name: config-volume
      mountPath: /config
```

### 8.3 è¿è¡Œæ—¶é…ç½®æ£€æŸ¥


**å¥åº·æ£€æŸ¥é…ç½®**ï¼š
```yaml
spec:
  containers:
  - name: app
    image: myapp:1.0
    readinessProbe:
      httpGet:
        path: /health/config
        port: 8080
      initialDelaySeconds: 10
    livenessProbe:
      httpGet:
        path: /health
        port: 8080
```

**é…ç½®ç›‘æ§å‘Šè­¦**ï¼š
```yaml
# é…ç½®é”™è¯¯æ£€æµ‹Pod
apiVersion: v1
kind: Pod
metadata:
  name: config-monitor
spec:
  containers:
  - name: monitor
    image: busybox
    command:
    - sh
    - -c
    - |
      while true; do
        # æ£€æŸ¥é…ç½®æ–‡ä»¶å®Œæ•´æ€§
        if ! [ -f /app/config/application.yml ]; then
          echo "ALERT: Configuration file missing"
        fi
        sleep 30
      done
```

---

## 9. âœ‚ï¸ å¤§é…ç½®æ–‡ä»¶åˆ†å‰²ç®¡ç†


### 9.1 é…ç½®æ–‡ä»¶åˆ†è§£ç­–ç•¥


**åŠŸèƒ½æ¨¡å—åˆ†ç¦»**ï¼š
```yaml
# æ•°æ®åº“é…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: database-config
data:
  database.yml: |
    primary:
      host: mysql-primary
      port: 3306
      database: app_db
    replica:
      host: mysql-replica
      port: 3306
      database: app_db

---
# ç¼“å­˜é…ç½®  
apiVersion: v1
kind: ConfigMap
metadata:
  name: cache-config
data:
  redis.yml: |
    cluster:
      nodes:
        - redis-1:6379
        - redis-2:6379
        - redis-3:6379
    timeout: 5000

---
# æ—¥å¿—é…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: logging-config
data:
  logback.xml: |
    <configuration>
      <appender name="FILE" class="ch.qos.logback.core.FileAppender">
        <file>/app/logs/application.log</file>
        <encoder>
          <pattern>%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
      </appender>
    </configuration>
```

### 9.2 é…ç½®ç»„åˆæŒ‚è½½


**å¤šConfigMapæŒ‚è½½**ï¼š
```yaml
spec:
  containers:
  - name: app
    image: myapp:1.0
    volumeMounts:
    # å„é…ç½®æŒ‚è½½åˆ°ä¸åŒç›®å½•
    - name: database-config
      mountPath: /app/config/database
    - name: cache-config
      mountPath: /app/config/cache
    - name: logging-config
      mountPath: /app/config/logging
      
  volumes:
  - name: database-config
    configMap:
      name: database-config
  - name: cache-config
    configMap:
      name: cache-config
  - name: logging-config
    configMap:
      name: logging-config
```

### 9.3 é…ç½®èšåˆå¤„ç†


**é…ç½®åˆå¹¶initContainer**ï¼š
```yaml
spec:
  initContainers:
  - name: config-merger
    image: yq:latest
    command:
    - sh
    - -c
    - |
      # åˆå¹¶å¤šä¸ªYAMLé…ç½®æ–‡ä»¶
      yq eval-all 'select(fileIndex == 0) * select(fileIndex == 1)' \
        /config-parts/database.yml /config-parts/cache.yml > /merged/application.yml
      
      # æ·»åŠ å…¶ä»–é…ç½®æ–‡ä»¶
      cp /config-parts/logback.xml /merged/
      
      echo "Configuration merge completed"
    volumeMounts:
    - name: config-parts
      mountPath: /config-parts
    - name: merged-config
      mountPath: /merged
      
  containers:
  - name: app
    image: myapp:1.0
    volumeMounts:
    - name: merged-config
      mountPath: /app/config
      
  volumes:
  - name: merged-config
    emptyDir: {}
```

---

## 10. ğŸ“‹ é…ç½®ç‰ˆæœ¬æ§åˆ¶ä¸å›æ»š


### 10.1 é…ç½®ç‰ˆæœ¬ç®¡ç†


**ç‰ˆæœ¬æ ‡è®°ç­–ç•¥**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  labels:
    app: myapp
    version: v1.2.3
  annotations:
    config.version: "1.2.3"
    config.changelog: "Updated database timeout settings"
    config.created-by: "admin@company.com"
    config.created-at: "2024-01-15T10:30:00Z"
data:
  application.yml: |
    # Version 1.2.3
    server:
      port: 8080
    database:
      timeout: 30000  # å˜æ›´ï¼šä» 5000 å¢åŠ åˆ° 30000
```

### 10.2 é…ç½®å†å²å¤‡ä»½


**è‡ªåŠ¨å¤‡ä»½ç­–ç•¥**ï¼š
```bash
#!/bin/bash
# é…ç½®å¤‡ä»½è„šæœ¬

backup_config() {
    local configmap_name=$1
    local namespace=${2:-default}
    local backup_dir="/backup/configmaps"
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    mkdir -p ${backup_dir}/${namespace}
    
    # å¯¼å‡ºå½“å‰é…ç½®
    kubectl get configmap ${configmap_name} -n ${namespace} -o yaml > \
      ${backup_dir}/${namespace}/${configmap_name}-$(date +%Y%m%d-%H%M%S).yaml
    
    # ä¿ç•™æœ€è¿‘10ä¸ªå¤‡ä»½
    ls -t ${backup_dir}/${namespace}/${configmap_name}-*.yaml | tail -n +11 | xargs rm -f
}

# æ›´æ–°é…ç½®å‰è‡ªåŠ¨å¤‡ä»½
backup_config "app-config" "production"
```

### 10.3 é…ç½®å›æ»šæœºåˆ¶


**å¿«é€Ÿå›æ»šæ“ä½œ**ï¼š
```bash
# æŸ¥çœ‹é…ç½®å†å²
kubectl get configmap app-config -o yaml --export > current-config.yaml

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
kubectl apply -f backup/configmaps/default/app-config-20240115-103000.yaml

# è§¦å‘åº”ç”¨é‡å¯ä»¥åº”ç”¨æ–°é…ç½®
kubectl rollout restart deployment/app
```

**é…ç½®å˜æ›´è®°å½•**ï¼š
```yaml
# é…ç½®å˜æ›´è¿½è¸ª
apiVersion: v1
kind: ConfigMap
metadata:
  name: config-changes
data:
  changelog.txt: |
    v1.2.3 - 2024-01-15T10:30:00Z
    - Updated database timeout from 5000 to 30000ms
    - Added Redis cluster configuration
    - Changed log level from INFO to WARN
    
    v1.2.2 - 2024-01-10T14:20:00Z  
    - Fixed database connection pool settings
    - Updated cache TTL configuration
```

**å›æ»šéªŒè¯æµç¨‹**ï¼š
```yaml
# å›æ»šåéªŒè¯Job
apiVersion: batch/v1
kind: Job
metadata:
  name: config-rollback-verify
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
      - name: verify
        image: busybox
        command:
        - sh
        - -c
        - |
          echo "Verifying configuration rollback..."
          
          # æ£€æŸ¥å…³é”®é…ç½®é¡¹
          if [ "$(grep 'database.timeout' /app/config/application.yml | cut -d: -f2 | tr -d ' ')" = "5000" ]; then
            echo "âœ… Database timeout rollback verified"
          else
            echo "âŒ Database timeout rollback failed"
            exit 1
          fi
          
          echo "Configuration rollback verification completed"
        volumeMounts:
        - name: app-config
          mountPath: /app/config
      volumes:
      - name: app-config
        configMap:
          name: app-config
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 ConfigMapåŸºç¡€æ¦‚å¿µ


```
ğŸ”¸ ä½œç”¨ï¼šé…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œç»Ÿä¸€ç®¡ç†åº”ç”¨é…ç½®
ğŸ”¸ æ•°æ®æ ¼å¼ï¼šé”®å€¼å¯¹ã€é…ç½®æ–‡ä»¶ã€JSON/YAML
ğŸ”¸ å­˜å‚¨é™åˆ¶ï¼šå•ä¸ªConfigMapæœ€å¤§1MB
ğŸ”¸ ä½¿ç”¨æ–¹å¼ï¼šç¯å¢ƒå˜é‡æ³¨å…¥ã€æ–‡ä»¶æŒ‚è½½
ğŸ”¸ æ›´æ–°æœºåˆ¶ï¼šæ”¯æŒçƒ­æ›´æ–°ï¼Œä½†éœ€è¦åº”ç”¨é…åˆ
```

### 11.2 åˆ›å»ºå’Œä½¿ç”¨æ–¹æ³•


**åˆ›å»ºæ–¹å¼å¯¹æ¯”**ï¼š
| æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|---------|------|------|
| `--from-literal` | ç®€å•é”®å€¼å¯¹ | å¿«é€Ÿåˆ›å»º | ä¸é€‚åˆå¤§é…ç½® |
| `--from-file` | é…ç½®æ–‡ä»¶ | ä¿æŒæ–‡ä»¶ç»“æ„ | éœ€è¦æœ¬åœ°æ–‡ä»¶ |
| YAMLå£°æ˜ | å¤æ‚é…ç½® | ç‰ˆæœ¬æ§åˆ¶å‹å¥½ | ç¼–å†™å¤æ‚ |

**ä½¿ç”¨æ–¹å¼é€‰æ‹©**ï¼š
```
ç¯å¢ƒå˜é‡æ–¹å¼ï¼š
âœ… é€‚åˆï¼šç®€å•é…ç½®å‚æ•°
âŒ ä¸é€‚åˆï¼šå¤§é…ç½®æ–‡ä»¶ã€éœ€è¦æ ¼å¼çš„é…ç½®

æ–‡ä»¶æŒ‚è½½æ–¹å¼ï¼š
âœ… é€‚åˆï¼šé…ç½®æ–‡ä»¶ã€éœ€è¦ä¿æŒæ ¼å¼çš„é…ç½®
âŒ ä¸é€‚åˆï¼šç®€å•çš„å¼€å…³å‚æ•°
```

### 11.3 æœ€ä½³å®è·µæ€»ç»“


**é…ç½®ç®¡ç†åŸåˆ™**ï¼š
```
ğŸ“ åˆ†ç¦»åŸåˆ™ï¼šé…ç½®ä¸ä»£ç å½»åº•åˆ†ç¦»
ğŸ“ åˆ†å±‚åŸåˆ™ï¼šåŸºç¡€é…ç½® + ç¯å¢ƒç‰¹å®šé…ç½®
ğŸ“ æ¨¡æ¿åŸåˆ™ï¼šä½¿ç”¨æ¨¡æ¿åŒ–å‡å°‘é‡å¤
ğŸ“ éªŒè¯åŸåˆ™ï¼šéƒ¨ç½²å‰éªŒè¯é…ç½®æ ¼å¼å’Œå†…å®¹
ğŸ“ ç‰ˆæœ¬åŸåˆ™ï¼šä¸ºé…ç½®æ·»åŠ ç‰ˆæœ¬å’Œå˜æ›´è®°å½•
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
```
â€¢ ConfigMapå¤§å°æ§åˆ¶åœ¨100KBä»¥å†…
â€¢ å¤§é…ç½®æ–‡ä»¶åˆ†å‰²ä¸ºå¤šä¸ªå°ConfigMap
â€¢ ä½¿ç”¨æ ‡ç­¾å’Œæ³¨è§£è¿›è¡Œé…ç½®åˆ†ç±»ç®¡ç†
â€¢ å®šæœŸæ¸…ç†unusedé…ç½®å‡å°‘etcdè´Ÿæ‹…
```

**å®‰å…¨æ³¨æ„äº‹é¡¹**ï¼š
```
âš ï¸ ConfigMapæ•°æ®æ˜æ–‡å­˜å‚¨ï¼Œä¸é€‚åˆæ•æ„Ÿä¿¡æ¯
âš ï¸ ä½¿ç”¨Secretå­˜å‚¨å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿé…ç½®
âš ï¸ é…ç½®RBACé™åˆ¶ConfigMapçš„è®¿é—®æƒé™
âš ï¸ å®šæœŸå®¡è®¡é…ç½®å˜æ›´ï¼Œå»ºç«‹å˜æ›´è®°å½•
```

**æ•…éšœæ’æŸ¥è¦ç‚¹**ï¼š
```
ğŸ”§ é…ç½®ä¸ç”Ÿæ•ˆï¼šæ£€æŸ¥æŒ‚è½½è·¯å¾„å’Œæ–‡ä»¶æƒé™
ğŸ”§ åº”ç”¨å¯åŠ¨å¤±è´¥ï¼šéªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼å’Œå¿…éœ€å­—æ®µ
ğŸ”§ çƒ­æ›´æ–°ä¸å·¥ä½œï¼šç¡®è®¤åº”ç”¨æ”¯æŒé…ç½®æ–‡ä»¶ç›‘æ§
ğŸ”§ ç¯å¢ƒå˜é‡ç¼ºå¤±ï¼šæ£€æŸ¥ConfigMapé”®åå’Œç¯å¢ƒå˜é‡è½¬æ¢è§„åˆ™
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ConfigMapå­˜é…ç½®ï¼Œä»£ç åˆ†ç¦»æ˜¯ç‹é“
- ç¯å¢ƒå˜é‡é…ç®€å•ï¼Œæ–‡ä»¶æŒ‚è½½é…å¤æ‚  
- çƒ­æ›´æ–°éœ€åº”ç”¨é…åˆï¼Œç‰ˆæœ¬ç®¡ç†é˜²å‡ºé”™
- æ¨¡æ¿åŒ–å‡å°‘é‡å¤ï¼ŒéªŒè¯ä¿è¯è´¨é‡å¥½