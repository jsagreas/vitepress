---
title: 7ã€Secretæ•æ„Ÿä¿¡æ¯ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [Secretæ¦‚å¿µä¸åŸºæœ¬ç†è§£](#1-Secretæ¦‚å¿µä¸åŸºæœ¬ç†è§£)
2. [Secretç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯](#2-Secretç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯)
3. [Base64ç¼–ç å¤„ç†æœºåˆ¶](#3-Base64ç¼–ç å¤„ç†æœºåˆ¶)
4. [é•œåƒæ‹‰å–å‡­è¯é…ç½®å®æˆ˜](#4-é•œåƒæ‹‰å–å‡­è¯é…ç½®å®æˆ˜)
5. [TLSè¯ä¹¦Secretç®¡ç†](#5-TLSè¯ä¹¦Secretç®¡ç†)
6. [Secretä½¿ç”¨æ–¹å¼æ·±å…¥](#6-Secretä½¿ç”¨æ–¹å¼æ·±å…¥)
7. [Secretè½®æ¢ä¸æ›´æ–°ç­–ç•¥](#7-Secretè½®æ¢ä¸æ›´æ–°ç­–ç•¥)
8. [RBACæƒé™æ§åˆ¶ä¸å®‰å…¨](#8-RBACæƒé™æ§åˆ¶ä¸å®‰å…¨)
9. [å¤–éƒ¨å¯†é’¥ç®¡ç†é›†æˆ](#9-å¤–éƒ¨å¯†é’¥ç®¡ç†é›†æˆ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Secretæ¦‚å¿µä¸åŸºæœ¬ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯Kubernetes Secret


> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> Secretæ˜¯Kubernetesä¸­ä¸“é—¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯çš„å¯¹è±¡ï¼Œæ¯”å¦‚å¯†ç ã€å¯†é’¥ã€è¯ä¹¦ç­‰ã€‚å®ƒå°±åƒæ˜¯ä¸€ä¸ª**åŠ å¯†ä¿é™©ç®±**ï¼ŒæŠŠæœºå¯†æ•°æ®ä¸Podåˆ†ç¦»å¼€æ¥ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦Secretï¼Ÿ**

```
ä¼ ç»Ÿåšæ³•çš„é—®é¢˜ï¼š
å®¹å™¨é•œåƒ â†’ åŒ…å«å¯†ç  â†’ ä¸å®‰å…¨ï¼Œä»»ä½•äººéƒ½èƒ½çœ‹åˆ°
é…ç½®æ–‡ä»¶ â†’ å†™æ­»å¯†ç  â†’ ä»£ç æ³„éœ²=å¯†ç æ³„éœ²

Kubernetes Secretè§£å†³æ–¹æ¡ˆï¼š
æ•æ„Ÿæ•°æ® â†’ å­˜å‚¨åœ¨Secret â†’ Podè¿è¡Œæ—¶åŠ¨æ€è·å–
```

### 1.2 Secretä¸ConfigMapçš„åŒºåˆ«


| ğŸ†š å¯¹æ¯”é¡¹ | **Secret** | **ConfigMap** | **ä½¿ç”¨åœºæ™¯** |
|---------|------------|---------------|-------------|
| **å­˜å‚¨å†…å®¹** | ğŸ”’ æ•æ„Ÿä¿¡æ¯ | ğŸ“„ æ™®é€šé…ç½® | å¯†ç  vs é…ç½®æ–‡ä»¶ |
| **å­˜å‚¨æ–¹å¼** | Base64ç¼–ç  | æ˜æ–‡å­˜å‚¨ | åŠ å¯† vs æ˜æ–‡ |
| **å®‰å…¨çº§åˆ«** | âš¡ é«˜ | ğŸ“ ä¸€èˆ¬ | æœºå¯† vs å…¬å¼€ |
| **è®¿é—®æ§åˆ¶** | ä¸¥æ ¼é™åˆ¶ | ç›¸å¯¹å®½æ¾ | æƒé™æ§åˆ¶ç¨‹åº¦ |

### 1.3 Secretçš„å·¥ä½œåŸç†


```
Secretå·¥ä½œæµç¨‹å›¾ï¼š

å¼€å‘è€…              Kubernetes API              Pod
   |                       |                     |
   |--[1]åˆ›å»ºSecret------->|                     |
   |   kubectl create     |                     |
   |                       |--[2]å­˜å‚¨åˆ°etcd----->|
   |                       |   (åŠ å¯†å­˜å‚¨)        |
   |                       |                     |
   |--[3]éƒ¨ç½²Pod---------->|                     |
   |   å¼•ç”¨Secret         |                     |
   |                       |--[4]æŒ‚è½½Secret---->|
   |                       |   ç¯å¢ƒå˜é‡/æ–‡ä»¶     |
   |                       |                     |
```

**å…³é”®ç†è§£ç‚¹ï¼š**
- Secretæ•°æ®åœ¨etcdä¸­**åŠ å¯†å­˜å‚¨**
- Podè¿è¡Œæ—¶æ‰**åŠ¨æ€æŒ‚è½½**Secret
- æ•°æ®ä¼ è¾“è¿‡ç¨‹**å…¨ç¨‹åŠ å¯†**
- æ”¯æŒ**æƒé™ç»†åˆ†æ§åˆ¶**

---

## 2. ğŸ“‹ Secretç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯


### 2.1 Opaqueç±»å‹Secret


> ğŸ’¡ **å®ç”¨è§£é‡Š**  
> Opaqueæ˜¯æœ€é€šç”¨çš„Secretç±»å‹ï¼Œå°±åƒä¸€ä¸ª**ä¸‡èƒ½ä¿é™©ç®±**ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•æ„Ÿæ•°æ®ã€‚

**å…¸å‹åº”ç”¨åœºæ™¯ï¼š**
- æ•°æ®åº“è¿æ¥å¯†ç 
- APIå¯†é’¥å’ŒToken
- åº”ç”¨ç¨‹åºé…ç½®å¯†é’¥

```yaml
# åˆ›å»ºé€šç”¨Secretç¤ºä¾‹
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
  namespace: default
type: Opaque
data:
  database-password: bXlzcWxwYXNzd29yZA==  # base64ç¼–ç 
  api-key: YWJjZGVmZ2hpams=               # base64ç¼–ç 
stringData:  # ç›´æ¥å†™æ˜æ–‡ï¼Œk8sè‡ªåŠ¨ç¼–ç 
  username: admin
  host: "mysql.example.com"
```

### 2.2 kubernetes.io/tlsç±»å‹Secret


**ä¸“é—¨ç”¨äºå­˜å‚¨TLSè¯ä¹¦å’Œç§é’¥**

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: tls-secret
  namespace: default
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTi...  # è¯ä¹¦å†…å®¹(base64)
  tls.key: LS0tLS1CRUdJTi...  # ç§é’¥å†…å®¹(base64)
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- HTTPSç½‘ç«™è¯ä¹¦
- æœåŠ¡é—´TLSé€šä¿¡
- Ingress SSLç»ˆæ­¢

### 2.3 kubernetes.io/dockerconfigjsonç±»å‹


**ä¸“é—¨ç”¨äºå®¹å™¨é•œåƒæ‹‰å–è®¤è¯**

```
é•œåƒæ‹‰å–æµç¨‹ï¼š
Podåˆ›å»º â†’ éœ€è¦ç§æœ‰é•œåƒ â†’ æŸ¥æ‰¾imagePullSecrets â†’ ä½¿ç”¨å‡­è¯æ‹‰å–é•œåƒ
```

---

## 3. ğŸ”¤ Base64ç¼–ç å¤„ç†æœºåˆ¶


### 3.1 ä¸ºä»€ä¹ˆä½¿ç”¨Base64ç¼–ç 


> âš ï¸ **é‡è¦ç†è§£**  
> Base64**ä¸æ˜¯åŠ å¯†**ï¼Œåªæ˜¯ç¼–ç ï¼å°±åƒæŠŠä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼Œæ‡‚è§„åˆ™çš„äººéƒ½èƒ½çœ‹æ‡‚ã€‚çœŸæ­£çš„å®‰å…¨é çš„æ˜¯Kubernetesçš„è®¿é—®æ§åˆ¶ã€‚

**Base64ç¼–ç çš„ä½œç”¨ï¼š**

```
åŸå§‹ç›®çš„ï¼šè§£å†³äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“é—®é¢˜
ASCIIæ–‡æœ¬ï¼šHello â†’ å¯ä»¥ç›´æ¥ä¼ è¾“
äºŒè¿›åˆ¶æ•°æ®ï¼šå›¾ç‰‡/è¯ä¹¦ â†’ éœ€è¦ç¼–ç æ‰èƒ½ä¼ è¾“
YAMLé™åˆ¶ï¼šåªèƒ½åŒ…å«æ–‡æœ¬ï¼Œä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦
```

### 3.2 æ‰‹åŠ¨ç¼–ç è§£ç æ“ä½œ


**ç¼–ç æ“ä½œï¼š**
```bash
# å°†æ˜æ–‡è½¬ä¸ºbase64
echo -n "mypassword" | base64
# è¾“å‡ºï¼šbXlwYXNzd29yZA==

# ç¼–ç æ–‡ä»¶å†…å®¹
cat cert.pem | base64 -w 0  # -w 0è¡¨ç¤ºä¸æ¢è¡Œ
```

**è§£ç æ“ä½œï¼š**
```bash
# å°†base64è½¬å›æ˜æ–‡
echo "bXlwYXNzd29yZA==" | base64 -d
# è¾“å‡ºï¼šmypassword

# æŸ¥çœ‹Secretä¸­çš„å®é™…å†…å®¹
kubectl get secret app-secrets -o yaml | grep password | awk '{print $2}' | base64 -d
```

### 3.3 stringDataçš„ä¾¿åˆ©æ€§


```yaml
# æ–¹å¼1ï¼šæ‰‹åŠ¨base64ç¼–ç 
data:
  password: bXlwYXNzd29yZA==

# æ–¹å¼2ï¼šä½¿ç”¨stringDataè‡ªåŠ¨ç¼–ç   
stringData:
  password: mypassword    # k8sè‡ªåŠ¨è½¬ä¸ºbase64
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> å¼€å‘æ—¶ç”¨`stringData`å†™æ˜æ–‡ï¼Œç”Ÿäº§ç¯å¢ƒç”¨`data`å†™base64ï¼Œæ—¢æ–¹ä¾¿åˆå®‰å…¨ã€‚

---

## 4. ğŸ³ é•œåƒæ‹‰å–å‡­è¯é…ç½®å®æˆ˜


### 4.1 ç§æœ‰é•œåƒä»“åº“è®¿é—®é—®é¢˜


**é—®é¢˜åœºæ™¯ï¼š**
```
Podåˆ›å»ºå¤±è´¥ï¼šErrImagePull
åŸå› ï¼šæ— æ³•ä»ç§æœ‰ä»“åº“æ‹‰å–é•œåƒ
è§£å†³ï¼šé…ç½®é•œåƒæ‹‰å–å‡­è¯
```

### 4.2 åˆ›å»ºDocker Registry Secret


**æ–¹æ³•ä¸€ï¼šå‘½ä»¤è¡Œåˆ›å»º**
```bash
# ç›´æ¥åˆ›å»ºdocker-registryç±»å‹Secret
kubectl create secret docker-registry my-registry-secret \
  --docker-server=registry.example.com \
  --docker-username=myuser \
  --docker-password=mypassword \
  --docker-email=user@example.com
```

**æ–¹æ³•äºŒï¼šä»æœ¬åœ°Dockeré…ç½®åˆ›å»º**
```bash
# å…ˆåœ¨æœ¬åœ°ç™»å½•ç§æœ‰ä»“åº“
docker login registry.example.com

# ä»æœ¬åœ°é…ç½®åˆ›å»ºSecret
kubectl create secret generic my-registry-secret \
  --from-file=.dockerconfigjson=/home/user/.docker/config.json \
  --type=kubernetes.io/dockerconfigjson
```

### 4.3 Podä¸­ä½¿ç”¨é•œåƒæ‹‰å–å‡­è¯


```yaml
apiVersion: v1
kind: Pod
metadata:
  name: private-image-pod
spec:
  # æŒ‡å®šé•œåƒæ‹‰å–å‡­è¯
  imagePullSecrets:
  - name: my-registry-secret
  containers:
  - name: app
    image: registry.example.com/myapp:latest
    ports:
    - containerPort: 8080
```

### 4.4 ServiceAccountçº§åˆ«é…ç½®


```yaml
# ä¸ºServiceAccountæ·»åŠ é»˜è®¤æ‹‰å–å‡­è¯
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-service-account
imagePullSecrets:
- name: my-registry-secret
---
# Podä½¿ç”¨è¯¥ServiceAccountè‡ªåŠ¨è·å¾—æ‹‰å–æƒé™
apiVersion: v1
kind: Pod
metadata:
  name: auto-pull-pod
spec:
  serviceAccountName: my-service-account  # è‡ªåŠ¨ä½¿ç”¨æ‹‰å–å‡­è¯
  containers:
  - name: app
    image: registry.example.com/myapp:latest
```

---

## 5. ğŸ›¡ï¸ TLSè¯ä¹¦Secretç®¡ç†


### 5.1 TLSè¯ä¹¦çš„åº”ç”¨åœºæ™¯


```
TLSè¯ä¹¦ç”¨é€”åˆ†ç±»ï¼š

WebæœåŠ¡ï¼š
HTTPSç½‘ç«™ â†’ Ingress Controller â†’ TLS Secret

æœåŠ¡é—´é€šä¿¡ï¼š
å¾®æœåŠ¡A â†â†’ åŠ å¯†é€šä¿¡ â†â†’ å¾®æœåŠ¡B
        â†‘
     TLS Secret
```

### 5.2 åˆ›å»ºTLS Secret


**æ–¹æ³•ä¸€ï¼šä»è¯ä¹¦æ–‡ä»¶åˆ›å»º**
```bash
# ä»ç°æœ‰è¯ä¹¦æ–‡ä»¶åˆ›å»º
kubectl create secret tls my-tls-secret \
  --cert=path/to/cert.pem \
  --key=path/to/key.pem
```

**æ–¹æ³•äºŒï¼šYAMLé…ç½®åˆ›å»º**
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: website-tls
  namespace: web
type: kubernetes.io/tls
data:
  tls.crt: |
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0t...
    # è¯ä¹¦å†…å®¹(base64ç¼–ç )
  tls.key: |
    LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0t...
    # ç§é’¥å†…å®¹(base64ç¼–ç )
```

### 5.3 Ingressä¸­ä½¿ç”¨TLS Secret


```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: secure-ingress
spec:
  tls:
  - hosts:
    - www.example.com
    secretName: website-tls  # å¼•ç”¨TLS Secret
  rules:
  - host: www.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web-service
            port:
              number: 80
```

### 5.4 è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†


> ğŸ”¥ **ç”Ÿäº§å®è·µ**  
> ç»“åˆcert-managerå®ç°Let's Encryptè¯ä¹¦è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸã€‚

```yaml
# ä½¿ç”¨cert-managerè‡ªåŠ¨ç®¡ç†è¯ä¹¦
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: auto-cert
spec:
  secretName: auto-tls-secret  # è‡ªåŠ¨åˆ›å»ºçš„Secretåç§°
  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer
  dnsNames:
  - www.example.com
```

---

## 6. ğŸ”„ Secretä½¿ç”¨æ–¹å¼æ·±å…¥


### 6.1 ç¯å¢ƒå˜é‡æ–¹å¼


**åŸºæœ¬ç¯å¢ƒå˜é‡æ³¨å…¥ï¼š**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: env-secret-pod
spec:
  containers:
  - name: app
    image: nginx
    env:
    # å•ä¸ªé”®å€¼å¯¹
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: app-secrets
          key: database-password
    # æ‰€æœ‰é”®å€¼å¯¹
    envFrom:
    - secretRef:
        name: app-secrets
        prefix: APP_  # æ·»åŠ å‰ç¼€ï¼šAPP_database-password
```

**ç¯å¢ƒå˜é‡çš„ç‰¹ç‚¹ï¼š**

| ğŸ†š ç‰¹æ€§ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|----------|----------|
| **è®¿é—®æ–¹å¼** | ç¨‹åºç›´æ¥è¯»å– | è¿›ç¨‹åˆ—è¡¨å¯è§ |
| **æ›´æ–°æœºåˆ¶** | å®¹å™¨é‡å¯ç”Ÿæ•ˆ | æ— æ³•åŠ¨æ€æ›´æ–° |
| **å®‰å…¨æ€§** | å†…å­˜ä¸­å­˜å‚¨ | å¯èƒ½è¢«è½¬å‚¨ |

### 6.2 æ–‡ä»¶æŒ‚è½½æ–¹å¼


**VolumeæŒ‚è½½Secretï¼š**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: volume-secret-pod
spec:
  containers:
  - name: app
    image: nginx
    volumeMounts:
    - name: secret-volume
      mountPath: /etc/secrets     # æŒ‚è½½åˆ°å®¹å™¨å†…è·¯å¾„
      readOnly: true
  volumes:
  - name: secret-volume
    secret:
      secretName: app-secrets
      defaultMode: 0400           # æ–‡ä»¶æƒé™è®¾ç½®
      items:                      # é€‰æ‹©æ€§æŒ‚è½½
      - key: database-password
        path: db-pass.txt
      - key: api-key
        path: api.key
```

**æŒ‚è½½åçš„æ–‡ä»¶ç»“æ„ï¼š**
```
å®¹å™¨å†…æ–‡ä»¶ç³»ç»Ÿï¼š
/etc/secrets/
â”œâ”€â”€ db-pass.txt    # å†…å®¹ï¼šmypassword
â””â”€â”€ api.key        # å†…å®¹ï¼šabcdefghijk
```

### 6.3 ä¸¤ç§æ–¹å¼çš„é€‰æ‹©å»ºè®®


> ğŸ“Œ **é€‰æ‹©å»ºè®®**  
> 
> **ç¯å¢ƒå˜é‡é€‚åˆï¼š**  
> âœ… åº”ç”¨å¯åŠ¨æ—¶è¯»å–ä¸€æ¬¡çš„é…ç½®  
> âœ… ç®€å•çš„å­—ç¬¦ä¸²ç±»å‹æ•°æ®  
> 
> **æ–‡ä»¶æŒ‚è½½é€‚åˆï¼š**  
> âœ… è¯ä¹¦ã€å¯†é’¥ç­‰äºŒè¿›åˆ¶æ•°æ®  
> âœ… éœ€è¦åŠ¨æ€æ›´æ–°çš„é…ç½®  
> âœ… å¯¹å®‰å…¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯  

---

## 7. ğŸ”„ Secretè½®æ¢ä¸æ›´æ–°ç­–ç•¥


### 7.1 Secretæ›´æ–°çš„å¿…è¦æ€§


**ä¸ºä»€ä¹ˆè¦å®šæœŸè½®æ¢å¯†é’¥ï¼Ÿ**

```
å®‰å…¨é£é™©è¯„ä¼°ï¼š
æ—¶é—´è¶Šé•¿ â†’ æ³„éœ²é£é™©è¶Šé«˜ â†’ å½±å“èŒƒå›´è¶Šå¤§

æœ€ä½³å®è·µå‘¨æœŸï¼š
æ•°æ®åº“å¯†ç ï¼š3-6ä¸ªæœˆè½®æ¢ä¸€æ¬¡
APIå¯†é’¥ï¼š1-3ä¸ªæœˆè½®æ¢ä¸€æ¬¡  
TLSè¯ä¹¦ï¼š1å¹´è½®æ¢ä¸€æ¬¡
```

### 7.2 æ‰‹åŠ¨æ›´æ–°Secret


**æ–¹å¼ä¸€ï¼škubectl patchæ›´æ–°**
```bash
# æ›´æ–°å•ä¸ªå­—æ®µ
kubectl patch secret app-secrets -p '{"data":{"database-password":"bmV3cGFzc3dvcmQ="}}'

# ä½¿ç”¨stringDataæ›´æ–°(æ¨è)
kubectl patch secret app-secrets -p '{"stringData":{"database-password":"newpassword"}}'
```

**æ–¹å¼äºŒï¼šæ›¿æ¢æ•´ä¸ªSecret**
```bash
# åˆ é™¤æ—§Secret
kubectl delete secret app-secrets

# åˆ›å»ºæ–°Secret
kubectl create secret generic app-secrets \
  --from-literal=database-password=newpassword \
  --from-literal=api-key=newkey123
```

### 7.3 è‡ªåŠ¨åŒ–è½®æ¢ç­–ç•¥


**ä½¿ç”¨External Secrets Operatorï¼š**
```yaml
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
spec:
  provider:
    vault:
      server: "http://vault.example.com"
      path: "secret"
      auth:
        tokenSecretRef:
          name: "vault-token"
          key: "token"
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: app-secret
spec:
  refreshInterval: 15s  # 15ç§’æ£€æŸ¥ä¸€æ¬¡æ›´æ–°
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: app-secrets
    creationPolicy: Owner
  data:
  - secretKey: database-password
    remoteRef:
      key: myapp/config
      property: db-password
```

### 7.4 åº”ç”¨æ„ŸçŸ¥æ›´æ–°


**Podè‡ªåŠ¨é‡å¯ç­–ç•¥ï¼š**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-deployment
spec:
  template:
    metadata:
      annotations:
        # Secretå†…å®¹å˜åŒ–æ—¶è‡ªåŠ¨é‡å¯Pod
        secret-hash: "{{ .Values.secretHash }}"
    spec:
      containers:
      - name: app
        image: myapp:latest
        envFrom:
        - secretRef:
            name: app-secrets
```

---

## 8. ğŸ›¡ï¸ RBACæƒé™æ§åˆ¶ä¸å®‰å…¨


### 8.1 Secretè®¿é—®æƒé™æ§åˆ¶


**RBACæƒé™è®¾è®¡åŸåˆ™ï¼š**

```
æƒé™æœ€å°åŒ–åŸåˆ™ï¼š
å¼€å‘è€… â†’ åªèƒ½è¯»å–å¼€å‘ç¯å¢ƒSecret
è¿ç»´è€… â†’ å¯ä»¥ç®¡ç†ç”Ÿäº§ç¯å¢ƒSecret  
åº”ç”¨Pod â†’ åªèƒ½è®¿é—®è‡ªå·±éœ€è¦çš„Secret
```

### 8.2 åˆ›å»ºSecretä¸“ç”¨è§’è‰²


```yaml
# åˆ›å»ºSecretåªè¯»è§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: production
  name: secret-reader
rules:
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list"]
  resourceNames: ["app-secrets", "db-secrets"]  # é™åˆ¶ç‰¹å®šSecret
---
# åˆ›å»ºSecretç®¡ç†è§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: production  
  name: secret-manager
rules:
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list", "create", "update", "patch", "delete"]
```

### 8.3 ç”¨æˆ·æƒé™ç»‘å®š


```yaml
# å°†å¼€å‘è€…ç»‘å®šåˆ°åªè¯»è§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: dev-secret-access
  namespace: development
subjects:
- kind: User
  name: developer@company.com
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: secret-reader
  apiGroup: rbac.authorization.k8s.io
```

### 8.4 ServiceAccountæƒé™æ§åˆ¶


```yaml
# Podä¸“ç”¨ServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: app-service-account
  namespace: production
---
# æœ€å°æƒé™è§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: production
  name: app-secret-access
rules:
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get"]
  resourceNames: ["app-secrets"]  # åªèƒ½è®¿é—®ç‰¹å®šSecret
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: app-secret-binding
  namespace: production
subjects:
- kind: ServiceAccount
  name: app-service-account
  namespace: production
roleRef:
  kind: Role
  name: app-secret-access
  apiGroup: rbac.authorization.k8s.io
```

---

## 9. ğŸ”— å¤–éƒ¨å¯†é’¥ç®¡ç†é›†æˆ


### 9.1 ä¸ºä»€ä¹ˆéœ€è¦å¤–éƒ¨å¯†é’¥ç®¡ç†


**KubernetesåŸç”ŸSecretçš„å±€é™æ€§ï¼š**

| ğŸ†š å¯¹æ¯”é¡¹ | **K8s Secret** | **å¤–éƒ¨ç³»ç»Ÿ** | **è§£å†³é—®é¢˜** |
|---------|----------------|--------------|-------------|
| **å¯†é’¥ç”Ÿæˆ** | æ‰‹åŠ¨åˆ›å»º | è‡ªåŠ¨ç”Ÿæˆ | å¯†é’¥è´¨é‡ |
| **è®¿é—®å®¡è®¡** | åŸºç¡€æ—¥å¿— | è¯¦ç»†å®¡è®¡ | åˆè§„è¦æ±‚ |
| **å¯†é’¥è½®æ¢** | æ‰‹åŠ¨æ“ä½œ | è‡ªåŠ¨è½®æ¢ | è¿ç»´è´Ÿæ‹… |
| **å¤šç¯å¢ƒåŒæ­¥** | å„è‡ªç®¡ç† | ç»Ÿä¸€ç®¡ç† | ä¸€è‡´æ€§ |

### 9.2 HashiCorp Vaulté›†æˆ


**Vault Agentæ¨¡å¼ï¼š**
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-agent-config
data:
  config.hcl: |
    vault {
      address = "https://vault.example.com"
    }
    
    auto_auth {
      method "kubernetes" {
        mount_path = "auth/kubernetes"
        config = {
          role = "myapp-role"
        }
      }
      
      sink "file" {
        config = {
          path = "/home/vault/.vault-token"
        }
      }
    }
    
    template {
      source      = "/etc/secrets/db-password.tpl"
      destination = "/etc/secrets/db-password"
    }
```

### 9.3 External Secrets Operator


**ç»Ÿä¸€çš„å¤–éƒ¨å¯†é’¥è®¿é—®æ–¹æ¡ˆï¼š**
```yaml
# æ”¯æŒå¤šç§åç«¯ï¼šVaultã€AWS Secrets Managerã€Azure Key Vaultç­‰
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: vault-backend
spec:
  provider:
    vault:
      server: "https://vault.example.com"
      path: "secret"
      version: "v2"
      auth:
        kubernetes:
          mountPath: "kubernetes"
          role: "external-secrets"
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: vault-secret
  namespace: default
spec:
  refreshInterval: 30s
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    name: example-secret
    creationPolicy: Owner
  data:
  - secretKey: password
    remoteRef:
      key: database/config
      property: password
```

### 9.4 äº‘å‚å•†å¯†é’¥ç®¡ç†æœåŠ¡


**AWS Secrets Manageré›†æˆç¤ºä¾‹ï¼š**
```yaml
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        secretRef:
          accessKeyID:
            name: awssm-secret
            key: access-key
          secretAccessKey:
            name: awssm-secret
            key: secret-access-key
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Secretæœ¬è´¨ï¼šKubernetesä¸­çš„æ•æ„Ÿæ•°æ®ä¿é™©ç®±
ğŸ”¸ ä¸‰å¤§ç±»å‹ï¼šOpaque(é€šç”¨)ã€TLSè¯ä¹¦ã€Dockerå‡­è¯
ğŸ”¸ Base64ç¼–ç ï¼šä¸æ˜¯åŠ å¯†ï¼Œåªæ˜¯ç¼–ç æ ¼å¼
ğŸ”¸ ä¸¤ç§ä½¿ç”¨ï¼šç¯å¢ƒå˜é‡æ³¨å…¥ã€æ–‡ä»¶VolumeæŒ‚è½½
ğŸ”¸ å®‰å…¨ç®¡æ§ï¼šRBACæƒé™æ§åˆ¶ + å¤–éƒ¨å¯†é’¥é›†æˆ
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Secret vs ConfigMapé€‰æ‹©**
```
åˆ¤æ–­æ ‡å‡†ï¼š
æ•°æ®æ•æ„Ÿæ€§ â†’ Secret (å¯†ç ã€å¯†é’¥ã€è¯ä¹¦)
æ•°æ®é€šç”¨æ€§ â†’ ConfigMap (é…ç½®æ–‡ä»¶ã€å‚æ•°)
è®¿é—®æ§åˆ¶ â†’ Secret (ä¸¥æ ¼æƒé™æ§åˆ¶)
```

**ğŸ”¹ ä½¿ç”¨æ–¹å¼é€‰æ‹©ç­–ç•¥**
```
ç¯å¢ƒå˜é‡é€‚åˆï¼š
â€¢ åº”ç”¨å¯åŠ¨é…ç½®
â€¢ ç®€å•å­—ç¬¦ä¸²
â€¢ ä¸€æ¬¡æ€§è¯»å–

æ–‡ä»¶æŒ‚è½½é€‚åˆï¼š
â€¢ è¯ä¹¦å¯†é’¥æ–‡ä»¶
â€¢ å¤§é‡é…ç½®æ•°æ®  
â€¢ éœ€è¦åŠ¨æ€æ›´æ–°
```

**ğŸ”¹ å®‰å…¨æœ€ä½³å®è·µ**
```
åˆ›å»ºé˜¶æ®µï¼šä½¿ç”¨stringDataé¿å…æ‰‹åŠ¨base64
å­˜å‚¨é˜¶æ®µï¼šå¯ç”¨etcdåŠ å¯†ï¼Œé…ç½®RBACæƒé™
ä½¿ç”¨é˜¶æ®µï¼šæœ€å°æƒé™åŸåˆ™ï¼Œå®šæœŸè½®æ¢æ›´æ–°
ä¼ è¾“é˜¶æ®µï¼šTLSåŠ å¯†ï¼Œé¿å…æ˜æ–‡ä¼ è¾“
```

### 10.3 ç”Ÿäº§ç¯å¢ƒå®è·µæŒ‡å—


**ğŸ“Š Secretç®¡ç†æˆç†Ÿåº¦è¯„ä¼°**

ğŸŒ± **åŸºç¡€çº§**ï¼šæ‰‹åŠ¨åˆ›å»ºSecretï¼ŒPodç¯å¢ƒå˜é‡ä½¿ç”¨  
ğŸŒ¿ **è¿›é˜¶çº§**ï¼šRBACæƒé™æ§åˆ¶ï¼Œå®šæœŸæ‰‹åŠ¨è½®æ¢  
ğŸŒ³ **ä¸“å®¶çº§**ï¼šå¤–éƒ¨å¯†é’¥é›†æˆï¼Œè‡ªåŠ¨è½®æ¢ï¼Œå®¡è®¡åˆè§„  

**ğŸ”§ å·¥å…·é€‰å‹å»ºè®®**
```
å°å›¢é˜Ÿï¼škubectl + æ‰‹åŠ¨ç®¡ç†
ä¸­ç­‰è§„æ¨¡ï¼šExternal Secrets Operator + Vault
å¤§å‹ä¼ä¸šï¼šäº‘å‚å•†å¯†é’¥ç®¡ç† + è‡ªåŠ¨åŒ–CI/CD
```

**âš ï¸ å¸¸è§å®‰å…¨é™·é˜±**
```
âŒ å°†Secretæäº¤åˆ°ä»£ç ä»“åº“
âŒ åœ¨æ—¥å¿—ä¸­æ‰“å°Secretå†…å®¹  
âŒ ä½¿ç”¨è¿‡äºå®½æ³›çš„RBACæƒé™
âŒ é•¿æœŸä¸è½®æ¢å¯†é’¥
âŒ åœ¨ä¸å®‰å…¨çš„ç¯å¢ƒä¸­æ“ä½œSecret
```

**âœ… å®‰å…¨æ£€æŸ¥æ¸…å•**
```
- [ ] Secretä½¿ç”¨stringDataåˆ›å»ºï¼Œé¿å…æ‰‹åŠ¨base64
- [ ] é…ç½®é€‚å½“çš„RBACæƒé™ï¼Œéµå¾ªæœ€å°æƒé™åŸåˆ™
- [ ] å®šæœŸè½®æ¢å¯†é’¥ï¼Œå»ºç«‹è½®æ¢è®¡åˆ’
- [ ] å¯ç”¨etcdåŠ å¯†ï¼Œä¿æŠ¤é™æ€æ•°æ®
- [ ] é›†æˆå¤–éƒ¨å¯†é’¥ç®¡ç†ï¼Œæå‡å®‰å…¨ç­‰çº§
- [ ] å»ºç«‹Secretè®¿é—®å®¡è®¡æœºåˆ¶
- [ ] ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„Secret
```

### 10.4 æ•…éšœæ’æŸ¥é€ŸæŸ¥


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**

```
é—®é¢˜ï¼šPodæ— æ³•å¯åŠ¨ï¼Œæ˜¾ç¤ºSecret not found
æ’æŸ¥ï¼škubectl get secret -n <namespace>
è§£å†³ï¼šç¡®è®¤Secretåç§°å’Œå‘½åç©ºé—´æ­£ç¡®

é—®é¢˜ï¼šé•œåƒæ‹‰å–å¤±è´¥ï¼ŒErrImagePull  
æ’æŸ¥ï¼škubectl describe pod <pod-name>
è§£å†³ï¼šæ£€æŸ¥imagePullSecretsé…ç½®

é—®é¢˜ï¼šåº”ç”¨æ— æ³•è¯»å–Secretæ•°æ®
æ’æŸ¥ï¼škubectl exec pod -- env | grep <KEY>
è§£å†³ï¼šç¡®è®¤ç¯å¢ƒå˜é‡åç§°æˆ–æŒ‚è½½è·¯å¾„
```

**ğŸ“š æ‰©å±•å­¦ä¹ å»ºè®®**
- æ·±å…¥å­¦ä¹ etcdåŠ å¯†é…ç½®
- æŒæ¡cert-managerè¯ä¹¦è‡ªåŠ¨åŒ–
- äº†è§£Service Meshä¸­çš„å¯†é’¥ç®¡ç†
- å­¦ä¹ äº‘åŸç”Ÿå®‰å…¨æœ€ä½³å®è·µ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Secretä¿é™©ç®±ï¼Œæ•æ„Ÿæ•°æ®è—
- Base64éåŠ å¯†ï¼Œæƒé™æ§åˆ¶å¼º
- ç¯å¢ƒå˜é‡å¿«ï¼Œæ–‡ä»¶æŒ‚è½½å¼º
- å®šæœŸè¦è½®æ¢ï¼Œå®‰å…¨ç¬¬ä¸€æ¡©