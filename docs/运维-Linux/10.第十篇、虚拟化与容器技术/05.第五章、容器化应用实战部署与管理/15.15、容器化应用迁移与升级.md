---
title: 15ã€å®¹å™¨åŒ–åº”ç”¨è¿ç§»ä¸å‡çº§
---
## ğŸ“š ç›®å½•

1. [ä¼ ç»Ÿåº”ç”¨å®¹å™¨åŒ–è¿ç§»](#1-ä¼ ç»Ÿåº”ç”¨å®¹å™¨åŒ–è¿ç§»)
2. [å®¹å™¨ç‰ˆæœ¬å‡çº§ç­–ç•¥](#2-å®¹å™¨ç‰ˆæœ¬å‡çº§ç­–ç•¥)
3. [æ•°æ®åº“å®¹å™¨åŒ–è¿ç§»](#3-æ•°æ®åº“å®¹å™¨åŒ–è¿ç§»)
4. [æœ‰çŠ¶æ€åº”ç”¨è¿ç§»](#4-æœ‰çŠ¶æ€åº”ç”¨è¿ç§»)
5. [è¿ç§»é£é™©è¯„ä¼°](#5-è¿ç§»é£é™©è¯„ä¼°)
6. [è¿ç§»æµ‹è¯•éªŒè¯](#6-è¿ç§»æµ‹è¯•éªŒè¯)
7. [è¿ç§»å›æ»šè®¡åˆ’](#7-è¿ç§»å›æ»šè®¡åˆ’)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ ä¼ ç»Ÿåº”ç”¨å®¹å™¨åŒ–è¿ç§»


### 1.1 ä¼ ç»Ÿåº”ç”¨è¿ç§»æ¦‚è¿°


**ä»€ä¹ˆæ˜¯ä¼ ç»Ÿåº”ç”¨å®¹å™¨åŒ–è¿ç§»ï¼Ÿ**
ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠåŸæœ¬è·‘åœ¨ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºä¸Šçš„è€åº”ç”¨ï¼Œé‡æ–°æ‰“åŒ…æˆå®¹å™¨çš„å½¢å¼æ¥è¿è¡Œã€‚

```
ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼ï¼š
åº”ç”¨ç¨‹åº â†’ ç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¸Š
é…ç½®æ–‡ä»¶ â†’ æ•£å¸ƒåœ¨ç³»ç»Ÿå„ä¸ªç›®å½•
ä¾èµ–åº“ â†’ ä¸ç³»ç»Ÿç¯å¢ƒæ·±åº¦è€¦åˆ

å®¹å™¨åŒ–åï¼š
åº”ç”¨ç¨‹åº â†’ æ‰“åŒ…åœ¨å®¹å™¨é•œåƒä¸­
é…ç½®æ–‡ä»¶ â†’ é€šè¿‡ç¯å¢ƒå˜é‡æˆ–æŒ‚è½½å·ç®¡ç†
ä¾èµ–åº“ â†’ å®¹å™¨å†…è‡ªåŒ…å«ï¼Œä¸å®¿ä¸»æœºéš”ç¦»
```

**ä¸ºä»€ä¹ˆè¦è¿›è¡Œå®¹å™¨åŒ–è¿ç§»ï¼Ÿ**
- **ç¯å¢ƒä¸€è‡´æ€§**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
- **éƒ¨ç½²ä¾¿æ·**ï¼šä¸€ä¸ªå‘½ä»¤å®Œæˆéƒ¨ç½²ï¼Œå‘Šåˆ«å¤æ‚çš„å®‰è£…æ­¥éª¤
- **èµ„æºåˆ©ç”¨ç‡**ï¼šå¤šä¸ªå®¹å™¨å…±äº«ä¸»æœºèµ„æºï¼Œæé«˜åˆ©ç”¨æ•ˆç‡
- **æ‰©å±•æ€§**ï¼šéœ€è¦æ›´å¤šå®ä¾‹æ—¶ï¼Œå¿«é€Ÿåˆ›å»ºæ–°å®¹å™¨

### 1.2 è¿ç§»å‰çš„åº”ç”¨åˆ†æ


**åº”ç”¨æ¶æ„åˆ†æ**
é¦–å…ˆè¦ææ¸…æ¥šä½ çš„åº”ç”¨æ˜¯ä»€ä¹ˆæ¶æ„ï¼š

```
å•ä½“åº”ç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webå‰ç«¯       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â†’ æ•´ä¸ªæ‰“åŒ…æˆä¸€ä¸ªå®¹å™¨
â”‚   ä¸šåŠ¡é€»è¾‘      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®è®¿é—®      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†å±‚åº”ç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webå±‚         â”‚ â†’ ç‹¬ç«‹å®¹å™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœåŠ¡å±‚        â”‚ â†’ ç‹¬ç«‹å®¹å™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®å±‚        â”‚ â†’ ç‹¬ç«‹å®¹å™¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¾èµ–å…³ç³»æ¢³ç†**
è¦æ¸…æ¥šåº”ç”¨éƒ½ä¾èµ–ä»€ä¹ˆï¼š

- **å¤–éƒ¨ä¾èµ–**ï¼šæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜æœåŠ¡
- **ç³»ç»Ÿä¾èµ–**ï¼šç‰¹å®šçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€ç³»ç»Ÿåº“
- **è¿è¡Œæ—¶ä¾èµ–**ï¼šJavaã€Pythonã€Node.js ç­‰è¿è¡Œç¯å¢ƒ
- **é…ç½®ä¾èµ–**ï¼šé…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€å¯†é’¥ç­‰

### 1.3 å®¹å™¨åŒ–æ”¹é€ æ­¥éª¤


**ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåŸºç¡€é•œåƒ**

```dockerfile
# é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ
FROM openjdk:11-jre-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# åˆ›å»ºåº”ç”¨ç”¨æˆ·ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
RUN groupadd -r appuser && useradd -r -g appuser appuser

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY target/myapp.jar app.jar

# è®¾ç½®æƒé™
RUN chown -R appuser:appuser /app
USER appuser

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨å‘½ä»¤
CMD ["java", "-jar", "app.jar"]
```

**ç¬¬äºŒæ­¥ï¼šå¤„ç†é…ç½®ç®¡ç†**

ä¼ ç»Ÿåº”ç”¨çš„é…ç½®æ–‡ä»¶é€šå¸¸å†™æ­»è·¯å¾„ï¼Œå®¹å™¨åŒ–æ—¶éœ€è¦çµæ´»å¤„ç†ï¼š

```bash
# ä¼ ç»Ÿæ–¹å¼ï¼šé…ç½®æ–‡ä»¶å†™æ­»è·¯å¾„
/etc/myapp/config.properties

# å®¹å™¨åŒ–æ–¹å¼ï¼šé€šè¿‡ç¯å¢ƒå˜é‡æˆ–æŒ‚è½½å·
docker run -e DB_HOST=localhost \
           -e DB_PORT=3306 \
           -v /host/config:/app/config \
           myapp:latest
```

**ç¬¬ä¸‰æ­¥ï¼šæ•°æ®æŒä¹…åŒ–å¤„ç†**

```
æ•°æ®åˆ†ç±»ï¼š
åº”ç”¨æ•°æ® â†’ éœ€è¦æŒä¹…åŒ–ä¿å­˜
æ—¥å¿—æ•°æ® â†’ å¯ä»¥æŒ‚è½½åˆ°å®¿ä¸»æœº
ä¸´æ—¶æ•°æ® â†’ å®¹å™¨é‡å¯åå¯ä¸¢å¤±

æŒä¹…åŒ–æ–¹æ¡ˆï¼š
Docker Volume â†’ docker run -v mydata:/app/data
æŒ‚è½½ç›®å½• â†’ docker run -v /host/path:/container/path
ç½‘ç»œå­˜å‚¨ â†’ ä½¿ç”¨ NFSã€GlusterFS ç­‰
```

### 1.4 å¸¸è§æ”¹é€ é—®é¢˜ä¸è§£å†³


**é—®é¢˜1ï¼šåº”ç”¨å¯åŠ¨æ…¢**
```bash
# åŸå› ï¼šå®¹å™¨å¯åŠ¨æ—¶éœ€è¦åˆå§‹åŒ–å¾ˆå¤šç»„ä»¶
# è§£å†³ï¼šä¼˜åŒ–å¯åŠ¨è¿‡ç¨‹

# å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å°
FROM maven:3.6-openjdk-11 AS builder
COPY . /app
WORKDIR /app
RUN mvn clean package -DskipTests

FROM openjdk:11-jre-slim
COPY --from=builder /app/target/app.jar .
```

**é—®é¢˜2ï¼šç½‘ç»œè¿æ¥é—®é¢˜**
```bash
# åŸå› ï¼šå®¹å™¨ç½‘ç»œä¸ä¼ ç»Ÿç½‘ç»œä¸åŒ
# è§£å†³ï¼šæ­£ç¡®é…ç½®ç½‘ç»œ

# ä½¿ç”¨bridgeç½‘ç»œ
docker run --network bridge myapp

# ä½¿ç”¨hostç½‘ç»œï¼ˆä¸å®¿ä¸»æœºå…±äº«ï¼‰
docker run --network host myapp

# è‡ªå®šä¹‰ç½‘ç»œ
docker network create mynetwork
docker run --network mynetwork myapp
```

---

## 2. â¬†ï¸ å®¹å™¨ç‰ˆæœ¬å‡çº§ç­–ç•¥


### 2.1 å‡çº§ç­–ç•¥æ¦‚è¿°


**ä»€ä¹ˆæ˜¯å®¹å™¨ç‰ˆæœ¬å‡çº§ï¼Ÿ**
å°±æ˜¯æŠŠè¿è¡Œä¸­çš„æ—§ç‰ˆæœ¬å®¹å™¨æ›¿æ¢æˆæ–°ç‰ˆæœ¬å®¹å™¨çš„è¿‡ç¨‹ã€‚å¬èµ·æ¥ç®€å•ï¼Œä½†è¦åšåˆ°**ä¸å½±å“ç”¨æˆ·ä½¿ç”¨ã€ä¸ä¸¢å¤±æ•°æ®ã€èƒ½å¿«é€Ÿå›æ»š**ï¼Œå°±éœ€è¦å¥½çš„ç­–ç•¥ã€‚

### 2.2 è“ç»¿éƒ¨ç½²ç­–ç•¥


**è“ç»¿éƒ¨ç½²åŸç†**
åŒæ—¶ç»´æŠ¤ä¸¤å¥—å®Œå…¨ç›¸åŒçš„ç¯å¢ƒï¼šè“ç¯å¢ƒï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰å’Œç»¿ç¯å¢ƒï¼ˆæ–°ç‰ˆæœ¬ï¼‰

```
éƒ¨ç½²æµç¨‹ï¼š
æ­¥éª¤1ï¼šè“ç¯å¢ƒè¿è¡Œ v1.0
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è“ç¯å¢ƒ    â”‚â†â”€â”€â”€â”‚  è´Ÿè½½å‡è¡¡   â”‚
â”‚   v1.0     â”‚    â”‚   (ç”Ÿäº§)   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç»¿ç¯å¢ƒ    â”‚
â”‚   ç©ºé—²      â”‚
â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤2ï¼šåœ¨ç»¿ç¯å¢ƒéƒ¨ç½² v1.1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è“ç¯å¢ƒ    â”‚â†â”€â”€â”€â”‚  è´Ÿè½½å‡è¡¡   â”‚
â”‚   v1.0     â”‚    â”‚   (ç”Ÿäº§)   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç»¿ç¯å¢ƒ    â”‚
â”‚   v1.1     â”‚ â† éƒ¨ç½²æ–°ç‰ˆæœ¬
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤3ï¼šåˆ‡æ¢æµé‡åˆ°ç»¿ç¯å¢ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è“ç¯å¢ƒ    â”‚    â”‚  è´Ÿè½½å‡è¡¡   â”‚
â”‚   v1.0     â”‚    â”‚   (ç”Ÿäº§)   â”‚
â”‚            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â†“
â”‚   ç»¿ç¯å¢ƒ    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   v1.1     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®é™…æ“ä½œç¤ºä¾‹**

```bash
# ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨è“ç¯å¢ƒï¼ˆå½“å‰ç”Ÿäº§ç¯å¢ƒï¼‰
docker run -d --name blue-app \
    -p 8080:8080 \
    myapp:v1.0

# ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ç»¿ç¯å¢ƒï¼ˆæ–°ç‰ˆæœ¬ï¼‰
docker run -d --name green-app \
    -p 8081:8080 \
    myapp:v1.1

# ç¬¬ä¸‰æ­¥ï¼šéªŒè¯ç»¿ç¯å¢ƒ
curl http://localhost:8081/health

# ç¬¬å››æ­¥ï¼šåˆ‡æ¢è´Ÿè½½å‡è¡¡æŒ‡å‘ç»¿ç¯å¢ƒ
# (å…·ä½“æ“ä½œå–å†³äºä½ çš„è´Ÿè½½å‡è¡¡å™¨)

# ç¬¬äº”æ­¥ï¼šåœæ­¢è“ç¯å¢ƒ
docker stop blue-app
```

### 2.3 æ»šåŠ¨æ›´æ–°ç­–ç•¥


**æ»šåŠ¨æ›´æ–°åŸç†**
é€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬å®ä¾‹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨æ›¿æ¢

```
æ»šåŠ¨æ›´æ–°è¿‡ç¨‹ï¼š
åˆå§‹çŠ¶æ€ï¼š3ä¸ª v1.0 å®ä¾‹
[v1.0] [v1.0] [v1.0] â† ç”¨æˆ·è¯·æ±‚

æ›´æ–°æ­¥éª¤1ï¼šåœæ­¢1ä¸ªæ—§å®ä¾‹ï¼Œå¯åŠ¨1ä¸ªæ–°å®ä¾‹
[v1.0] [v1.0] [v1.1] â† ç”¨æˆ·è¯·æ±‚

æ›´æ–°æ­¥éª¤2ï¼šç»§ç»­æ›¿æ¢
[v1.0] [v1.1] [v1.1] â† ç”¨æˆ·è¯·æ±‚

æ›´æ–°æ­¥éª¤3ï¼šå®Œæˆæ›¿æ¢
[v1.1] [v1.1] [v1.1] â† ç”¨æˆ·è¯·æ±‚
```

**ä½¿ç”¨ Docker Compose å®ç°æ»šåŠ¨æ›´æ–°**

```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    image: myapp:v1.0
    replicas: 3
    update_config:
      parallelism: 1        # æ¯æ¬¡æ›´æ–°1ä¸ªå®ä¾‹
      delay: 10s           # å®ä¾‹é—´æ›´æ–°é—´éš”
      failure_action: rollback  # å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
    restart_policy:
      condition: on-failure
      max_attempts: 3
```

```bash
# æ‰§è¡Œæ»šåŠ¨æ›´æ–°
docker service update --image myapp:v1.1 myapp_app
```

### 2.4 ç°åº¦å‘å¸ƒç­–ç•¥


**ç°åº¦å‘å¸ƒåŸç†**
æ–°ç‰ˆæœ¬åªæœåŠ¡ä¸€å°éƒ¨åˆ†ç”¨æˆ·ï¼Œé€æ­¥æ‰©å¤§èŒƒå›´

```
ç°åº¦å‘å¸ƒæµç¨‹ï¼š
é˜¶æ®µ1ï¼š5%æµé‡åˆ°æ–°ç‰ˆæœ¬
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  95%  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°ç‰ˆæœ¬v1.1  â”‚â†â”€â”€â”€â”€â”€â”‚  è´Ÿè½½å‡è¡¡   â”‚
â”‚    â–ˆ        â”‚      â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  5%  â”‚           â”‚
â”‚  æ—§ç‰ˆæœ¬v1.0  â”‚â†â”€â”€â”€â”€â”€â”‚           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2ï¼šé€æ­¥å¢åŠ åˆ°50%
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  50% â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°ç‰ˆæœ¬v1.1  â”‚â†â”€â”€â”€â”€â”‚  è´Ÿè½½å‡è¡¡   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆ        â”‚     â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  50%â”‚           â”‚
â”‚  æ—§ç‰ˆæœ¬v1.0  â”‚â†â”€â”€â”€â”€â”‚           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆ        â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ3ï¼š100%åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 100%â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°ç‰ˆæœ¬v1.1  â”‚â†â”€â”€â”€â”€â”‚  è´Ÿè½½å‡è¡¡   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚     â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸ—„ï¸ æ•°æ®åº“å®¹å™¨åŒ–è¿ç§»


### 3.1 æ•°æ®åº“å®¹å™¨åŒ–åŸºç¡€


**æ•°æ®åº“å®¹å™¨åŒ–çš„ç‰¹æ®Šè€ƒè™‘**
æ•°æ®åº“ä¸åŒäºæ™®é€šåº”ç”¨ï¼Œå®ƒæœ‰å‡ ä¸ªç‰¹æ®Šè¦æ±‚ï¼š
- **æ•°æ®æŒä¹…åŒ–**ï¼šå®¹å™¨åˆ é™¤äº†ï¼Œæ•°æ®ä¸èƒ½ä¸¢
- **æ€§èƒ½è¦æ±‚**ï¼šI/Oæ€§èƒ½ä¸èƒ½æœ‰æ˜æ˜¾ä¸‹é™
- **æ•°æ®ä¸€è‡´æ€§**ï¼šè¿ç§»è¿‡ç¨‹ä¸­ä¸èƒ½ä¸¢å¤±æˆ–æŸåæ•°æ®
- **è¿æ¥åˆ‡æ¢**ï¼šåº”ç”¨è¿æ¥è¦å¹³æ»‘åˆ‡æ¢åˆ°æ–°æ•°æ®åº“

### 3.2 MySQLå®¹å™¨åŒ–è¿ç§»


**ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ®è¿ç§»**

```bash
# åŸMySQLæ•°æ®å¤‡ä»½
mysqldump -u root -p --all-databases > backup.sql

# æˆ–è€…å¤‡ä»½ç‰¹å®šæ•°æ®åº“
mysqldump -u root -p myapp_db > myapp_backup.sql
```

**ç¬¬äºŒæ­¥ï¼šå¯åŠ¨MySQLå®¹å™¨**

```bash
# åˆ›å»ºæ•°æ®å·ï¼ˆé‡è¦ï¼šæ•°æ®æŒä¹…åŒ–ï¼‰
docker volume create mysql_data

# å¯åŠ¨MySQLå®¹å™¨
docker run -d \
    --name mysql-server \
    -e MYSQL_ROOT_PASSWORD=mypassword \
    -e MYSQL_DATABASE=myapp_db \
    -v mysql_data:/var/lib/mysql \
    -p 3306:3306 \
    mysql:8.0
```

**ç¬¬ä¸‰æ­¥ï¼šæ¢å¤æ•°æ®**

```bash
# ç­‰å¾…MySQLå¯åŠ¨å®Œæˆ
docker exec mysql-server mysqladmin ping -u root -p

# æ¢å¤æ•°æ®
docker exec -i mysql-server mysql -u root -p < backup.sql
```

**ç¬¬å››æ­¥ï¼šåº”ç”¨è¿æ¥è¿ç§»**

```bash
# ä¼ ç»Ÿè¿æ¥æ–¹å¼
DB_HOST=192.168.1.100
DB_PORT=3306

# å®¹å™¨åŒ–åï¼ˆä½¿ç”¨å®¹å™¨åï¼‰
DB_HOST=mysql-server  # æˆ–è€…ä½¿ç”¨å®¿ä¸»æœºIP
DB_PORT=3306
```

### 3.3 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–


**å­˜å‚¨æ€§èƒ½ä¼˜åŒ–**

```bash
# ä½¿ç”¨é«˜æ€§èƒ½å­˜å‚¨å·
docker run -d \
    --name mysql-server \
    -v /fast-storage/mysql:/var/lib/mysql \  # ä½¿ç”¨SSDå­˜å‚¨
    --tmpfs /tmp \                           # ä¸´æ—¶ç›®å½•ä½¿ç”¨å†…å­˜
    mysql:8.0
```

**å†…å­˜é…ç½®ä¼˜åŒ–**

```bash
# è‡ªå®šä¹‰MySQLé…ç½®
docker run -d \
    --name mysql-server \
    -v ./my.cnf:/etc/mysql/conf.d/my.cnf \   # æŒ‚è½½é…ç½®æ–‡ä»¶
    -m 4g \                                   # é™åˆ¶å†…å­˜ä½¿ç”¨
    mysql:8.0
```

```ini
# my.cnf é…ç½®ç¤ºä¾‹
[mysqld]
innodb_buffer_pool_size = 2G
innodb_log_file_size = 256M
max_connections = 200
query_cache_size = 128M
```

### 3.4 Rediså®¹å™¨åŒ–è¿ç§»


**Redisæ•°æ®è¿ç§»æ›´ç®€å•**

```bash
# å¤‡ä»½Redisæ•°æ®
redis-cli --rdb backup.rdb

# å¯åŠ¨Rediså®¹å™¨
docker run -d \
    --name redis-server \
    -v redis_data:/data \
    -p 6379:6379 \
    redis:7-alpine

# æ¢å¤æ•°æ®
docker cp backup.rdb redis-server:/data/dump.rdb
docker restart redis-server
```

---

## 4. ğŸ“¦ æœ‰çŠ¶æ€åº”ç”¨è¿ç§»


### 4.1 æœ‰çŠ¶æ€ vs æ— çŠ¶æ€åº”ç”¨


**ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€åº”ç”¨ï¼Ÿ**
ç®€å•è¯´ï¼Œå°±æ˜¯åº”ç”¨éœ€è¦ä¿å­˜æ•°æ®ã€è®°ä½ä¹‹å‰å‘ç”Ÿçš„äº‹æƒ…ï¼š

```
æ— çŠ¶æ€åº”ç”¨ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨å¤„ç† â†’ è¿”å›ç»“æœ
æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–ä¹‹å‰çš„çŠ¶æ€

æœ‰çŠ¶æ€åº”ç”¨ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨å¤„ç† â†’ ä¿å­˜çŠ¶æ€ â†’ è¿”å›ç»“æœ
ä¸‹æ¬¡è¯·æ±‚ä¼šç”¨åˆ°ä¹‹å‰ä¿å­˜çš„çŠ¶æ€
```

**å¸¸è§çš„æœ‰çŠ¶æ€åº”ç”¨ï¼š**
- **æ•°æ®åº“**ï¼šMySQLã€PostgreSQLã€MongoDB
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šéœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„åº”ç”¨
- **ä¼šè¯ç®¡ç†**ï¼šä¿å­˜ç”¨æˆ·ç™»å½•çŠ¶æ€çš„åº”ç”¨
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šKafkaã€RabbitMQ

### 4.2 æœ‰çŠ¶æ€åº”ç”¨çš„æŒ‘æˆ˜


**æ•°æ®æŒä¹…åŒ–é—®é¢˜**
```
å®¹å™¨çš„ç‰¹ç‚¹ï¼š
- å®¹å™¨åˆ é™¤ï¼Œå†…éƒ¨æ•°æ®æ¶ˆå¤±
- å®¹å™¨é‡å¯ï¼Œä¸´æ—¶æ•°æ®ä¸¢å¤±

è§£å†³æ–¹æ¡ˆï¼š
- Docker Volumesï¼šdocker run -v data:/app/data
- å¤–éƒ¨å­˜å‚¨ï¼šNFSã€GlusterFSã€äº‘å­˜å‚¨
```

**å®ä¾‹ç®¡ç†å¤æ‚**
```
æ— çŠ¶æ€åº”ç”¨ï¼š
å¯ä»¥éšæ„åˆ›å»ºã€åˆ é™¤å®ä¾‹
[å®ä¾‹1] [å®ä¾‹2] [å®ä¾‹3] â† å®Œå…¨ç›¸åŒ

æœ‰çŠ¶æ€åº”ç”¨ï¼š
æ¯ä¸ªå®ä¾‹éƒ½æœ‰ç‹¬ç‰¹çš„èº«ä»½
[ä¸»èŠ‚ç‚¹] [ä»èŠ‚ç‚¹1] [ä»èŠ‚ç‚¹2] â† è§’è‰²ä¸åŒ
```

### 4.3 StatefulSet éƒ¨ç½²æ¨¡å¼


**StatefulSet è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ**
- **ç¨³å®šçš„ç½‘ç»œæ ‡è¯†**ï¼šæ¯ä¸ªå®ä¾‹æœ‰å›ºå®šçš„åç§°
- **æœ‰åºéƒ¨ç½²**ï¼šæŒ‰é¡ºåºå¯åŠ¨ï¼ŒæŒ‰é¡ºåºåœæ­¢
- **æŒä¹…åŒ–å­˜å‚¨**ï¼šæ¯ä¸ªå®ä¾‹æœ‰ç‹¬ç«‹çš„å­˜å‚¨å·

```yaml
# ä½¿ç”¨ StatefulSet éƒ¨ç½² MySQL ä¸»ä»
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql-cluster
spec:
  serviceName: mysql
  replicas: 3
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "password"
        volumeMounts:
        - name: mysql-data
          mountPath: /var/lib/mysql
  volumeClaimTemplates:
  - metadata:
      name: mysql-data
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 10Gi
```

**å®ä¾‹æ ‡è¯†è§„å¾‹**
```
StatefulSet åˆ›å»ºçš„å®ä¾‹å‘½åè§„å¾‹ï¼š
mysql-cluster-0  â† æ€»æ˜¯ç¬¬ä¸€ä¸ªå¯åŠ¨ï¼ˆé€šå¸¸ä½œä¸ºä¸»èŠ‚ç‚¹ï¼‰
mysql-cluster-1  â† ç¬¬äºŒä¸ªå¯åŠ¨
mysql-cluster-2  â† ç¬¬ä¸‰ä¸ªå¯åŠ¨

åˆ é™¤æ—¶ç›¸åé¡ºåºï¼š
mysql-cluster-2  â† é¦–å…ˆåˆ é™¤
mysql-cluster-1  â† ç„¶ååˆ é™¤
mysql-cluster-0  â† æœ€ååˆ é™¤
```

### 4.4 æ•°æ®è¿ç§»ç­–ç•¥


**åœ¨çº¿è¿ç§»æ–¹æ¡ˆ**

```bash
# ç¬¬ä¸€æ­¥ï¼šå»ºç«‹ä¸»ä»å¤åˆ¶
# ä¼ ç»ŸMySQLä½œä¸ºä¸»åº“ï¼Œå®¹å™¨MySQLä½œä¸ºä»åº“

# åœ¨ä¼ ç»ŸMySQLä¸Šåˆ›å»ºå¤åˆ¶ç”¨æˆ·
CREATE USER 'replica'@'%' IDENTIFIED BY 'password';
GRANT REPLICATION SLAVE ON *.* TO 'replica'@'%';

# è·å–ä¸»åº“çŠ¶æ€
SHOW MASTER STATUS;
# è®°å½• File å’Œ Position å€¼

# ç¬¬äºŒæ­¥ï¼šå¯åŠ¨å®¹å™¨MySQLå¹¶é…ç½®ä»åº“
docker run -d --name mysql-slave \
    -e MYSQL_ROOT_PASSWORD=password \
    -v mysql_slave_data:/var/lib/mysql \
    mysql:8.0

# åœ¨ä»åº“ä¸Šé…ç½®å¤åˆ¶
CHANGE MASTER TO 
    MASTER_HOST='192.168.1.100',
    MASTER_USER='replica',
    MASTER_PASSWORD='password',
    MASTER_LOG_FILE='mysql-bin.000001',
    MASTER_LOG_POS=154;

START SLAVE;

# ç¬¬ä¸‰æ­¥ï¼šéªŒè¯åŒæ­¥çŠ¶æ€
SHOW SLAVE STATUS\G
# ç¡®ä¿ Slave_IO_Running å’Œ Slave_SQL_Running éƒ½æ˜¯ Yes

# ç¬¬å››æ­¥ï¼šåˆ‡æ¢åº”ç”¨è¿æ¥
# ä¿®æ”¹åº”ç”¨é…ç½®ï¼Œä»ä¼ ç»ŸMySQLåˆ‡æ¢åˆ°å®¹å™¨MySQL
```

**ç¦»çº¿è¿ç§»æ–¹æ¡ˆ**

```bash
# é€‚ç”¨äºå¯ä»¥æ¥å—çŸ­æš‚åœæœºçš„åœºæ™¯

# ç¬¬ä¸€æ­¥ï¼šåœæ­¢åº”ç”¨ï¼ˆé¿å…æ•°æ®å†™å…¥ï¼‰
systemctl stop myapp

# ç¬¬äºŒæ­¥ï¼šå¤‡ä»½æ•°æ®
mysqldump -u root -p --all-databases > full_backup.sql

# ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨å®¹å™¨MySQL
docker run -d --name mysql-new \
    -e MYSQL_ROOT_PASSWORD=password \
    -v mysql_data:/var/lib/mysql \
    -p 3306:3306 \
    mysql:8.0

# ç¬¬å››æ­¥ï¼šæ¢å¤æ•°æ®
docker exec -i mysql-new mysql -u root -p < full_backup.sql

# ç¬¬äº”æ­¥ï¼šæ›´æ–°åº”ç”¨é…ç½®å¹¶é‡å¯
# ä¿®æ”¹æ•°æ®åº“è¿æ¥é…ç½®
systemctl start myapp
```

---

## 5. âš ï¸ è¿ç§»é£é™©è¯„ä¼°


### 5.1 é£é™©è¯†åˆ«ä¸åˆ†ç±»


**æŠ€æœ¯é£é™©**

| é£é™©ç±»å‹ | å…·ä½“è¡¨ç° | å½±å“ç¨‹åº¦ | é¢„é˜²æªæ–½ |
|---------|---------|---------|---------|
| **æ€§èƒ½ä¸‹é™** | å®¹å™¨åŒ–åå“åº”å˜æ…¢ | ğŸ”´ é«˜ | æ€§èƒ½æµ‹è¯•ã€èµ„æºé…ç½®ä¼˜åŒ– |
| **æ•°æ®ä¸¢å¤±** | è¿ç§»è¿‡ç¨‹æ•°æ®æŸå | ğŸ”´ æé«˜ | å¤šé‡å¤‡ä»½ã€åˆ†æ­¥éªŒè¯ |
| **å…¼å®¹æ€§é—®é¢˜** | åº”ç”¨åœ¨å®¹å™¨ä¸­æ— æ³•æ­£å¸¸è¿è¡Œ | ğŸŸ¡ ä¸­ | å……åˆ†æµ‹è¯•ã€ç¯å¢ƒéªŒè¯ |
| **ç½‘ç»œé—®é¢˜** | å®¹å™¨ç½‘ç»œé…ç½®é”™è¯¯ | ğŸŸ¡ ä¸­ | ç½‘ç»œè§„åˆ’ã€è¿é€šæ€§æµ‹è¯• |

**ä¸šåŠ¡é£é™©**

```
æœåŠ¡ä¸­æ–­é£é™©ï¼š
- è¿ç§»è¿‡ç¨‹ä¸­æœåŠ¡ä¸å¯ç”¨
- å½±å“ï¼šç”¨æˆ·ä½“éªŒä¸‹é™ï¼Œä¸šåŠ¡æŸå¤±
- æ§åˆ¶ï¼šé€‰æ‹©åˆé€‚çš„è¿ç§»çª—å£ï¼Œä½¿ç”¨æ— åœæœºè¿ç§»ç­–ç•¥

æ•°æ®ä¸€è‡´æ€§é£é™©ï¼š
- æ–°æ—§ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´
- å½±å“ï¼šä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼Œæ•°æ®æ··ä¹±
- æ§åˆ¶ï¼šæ•°æ®åŒæ­¥éªŒè¯ï¼Œæ ¡éªŒæœºåˆ¶

å›æ»šå¤æ‚æ€§ï¼š
- è¿ç§»å¤±è´¥åéš¾ä»¥å¿«é€Ÿæ¢å¤
- å½±å“ï¼šæ•…éšœæ¢å¤æ—¶é—´é•¿
- æ§åˆ¶ï¼šè¯¦ç»†çš„å›æ»šè®¡åˆ’å’Œæ¼”ç»ƒ
```

### 5.2 é£é™©è¯„ä¼°çŸ©é˜µ


**é£é™©è¯„ä¼°æ–¹æ³•**

```
é£é™©ç­‰çº§ = å‘ç”Ÿæ¦‚ç‡ Ã— å½±å“ç¨‹åº¦

å‘ç”Ÿæ¦‚ç‡ï¼š
1 = å¾ˆå°‘å‘ç”Ÿ (< 10%)
2 = å¶å°”å‘ç”Ÿ (10-30%)
3 = ç»å¸¸å‘ç”Ÿ (30-70%)
4 = å‡ ä¹å¿…ç„¶ (> 70%)

å½±å“ç¨‹åº¦ï¼š
1 = å½±å“å¾ˆå°
2 = å½±å“ä¸€èˆ¬
3 = å½±å“è¾ƒå¤§
4 = å½±å“ä¸¥é‡
```

**å…·ä½“é£é™©è¯„ä¼°ç¤ºä¾‹**

| é£é™©é¡¹ç›® | æ¦‚ç‡ | å½±å“ | é£é™©å€¼ | ç­‰çº§ | åº”å¯¹ç­–ç•¥ |
|---------|------|------|--------|------|----------|
| æ•°æ®åº“è¿ç§»å¤±è´¥ | 2 | 4 | 8 | ğŸ”´ é«˜é£é™© | è¯¦ç»†æµ‹è¯•+å¤‡ä»½è®¡åˆ’ |
| åº”ç”¨å¯åŠ¨å¤±è´¥ | 3 | 3 | 9 | ğŸ”´ é«˜é£é™© | å……åˆ†éªŒè¯+å¿«é€Ÿå›æ»š |
| æ€§èƒ½ä¸‹é™20% | 4 | 2 | 8 | ğŸ”´ é«˜é£é™© | æ€§èƒ½è°ƒä¼˜+ç›‘æ§é¢„è­¦ |
| ç½‘ç»œè¿æ¥é—®é¢˜ | 2 | 2 | 4 | ğŸŸ¡ ä¸­é£é™© | ç½‘ç»œæµ‹è¯•+å¤‡ç”¨æ–¹æ¡ˆ |

### 5.3 é£é™©æ§åˆ¶æªæ–½


**äº‹å‰é¢„é˜²**

```bash
# ç¯å¢ƒéªŒè¯
# åœ¨æµ‹è¯•ç¯å¢ƒå®Œå…¨æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒè¿›è¡ŒéªŒè¯

# 1. ç¡¬ä»¶èµ„æºéªŒè¯
docker stats  # ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

# 2. ç½‘ç»œè¿é€šæ€§éªŒè¯
docker exec -it myapp ping database-server

# 3. ä¾èµ–æœåŠ¡éªŒè¯
docker exec -it myapp curl http://api-server/health

# 4. æ•°æ®å®Œæ•´æ€§éªŒè¯
# å¯¹æ¯”è¿ç§»å‰åçš„æ•°æ®ä¸€è‡´æ€§
```

**äº‹ä¸­ç›‘æ§**

```bash
# å®æ—¶ç›‘æ§å…³é”®æŒ‡æ ‡
# 1. åº”ç”¨å“åº”æ—¶é—´
curl -w "@curl-format.txt" -s -o /dev/null http://myapp/api

# 2. èµ„æºä½¿ç”¨æƒ…å†µ
docker stats --no-stream

# 3. é”™è¯¯æ—¥å¿—ç›‘æ§
docker logs -f myapp | grep ERROR

# 4. æ•°æ®åº“è¿æ¥çŠ¶æ€
docker exec mysql-server mysql -e "SHOW PROCESSLIST"
```

**äº‹åæ¢å¤**

```bash
# å¿«é€Ÿå›æ»šé¢„æ¡ˆ
# 1. ä¿ç•™åŸç¯å¢ƒï¼ˆè¿ç§»æˆåŠŸå‰ä¸åˆ é™¤ï¼‰
# 2. è‡ªåŠ¨åŒ–å›æ»šè„šæœ¬
#!/bin/bash
echo "å¼€å§‹å›æ»š..."
docker stop new-app
docker start old-app
echo "å›æ»šå®Œæˆ"

# 3. æ•°æ®æ¢å¤æ–¹æ¡ˆ
# ä»å¤‡ä»½ä¸­æ¢å¤å…³é”®æ•°æ®
mysql -u root -p < backup_before_migration.sql
```

---

## 6. ğŸ§ª è¿ç§»æµ‹è¯•éªŒè¯


### 6.1 æµ‹è¯•ç¯å¢ƒæ­å»º


**æµ‹è¯•ç¯å¢ƒçš„é‡è¦æ€§**
åœ¨æ­£å¼è¿ç§»ä¹‹å‰ï¼Œå¿…é¡»åœ¨æµ‹è¯•ç¯å¢ƒä¸­å®Œæ•´éªŒè¯æ•´ä¸ªè¿ç§»è¿‡ç¨‹ï¼š

```
æµ‹è¯•ç¯å¢ƒè¦æ±‚ï¼š
ç¡¬ä»¶é…ç½® â†’ ä¸ç”Ÿäº§ç¯å¢ƒç›¸åŒæˆ–ç›¸ä¼¼
ç½‘ç»œç¯å¢ƒ â†’ æ¨¡æ‹Ÿç”Ÿäº§ç½‘ç»œæ‹“æ‰‘
æ•°æ®è§„æ¨¡ â†’ ä½¿ç”¨ç”Ÿäº§æ•°æ®çš„å­é›†æˆ–æ¨¡æ‹Ÿæ•°æ®
è´Ÿè½½æƒ…å†µ â†’ æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„è®¿é—®è´Ÿè½½
```

**ç¯å¢ƒæ­å»ºæ­¥éª¤**

```bash
# 1. å‡†å¤‡æµ‹è¯•æ•°æ®
# ä»ç”Ÿäº§ç¯å¢ƒå¯¼å‡ºéƒ¨åˆ†æ•°æ®ï¼ˆæ³¨æ„è„±æ•ï¼‰
mysqldump --where="created_date > '2024-01-01'" production_db > test_data.sql

# 2. æ­å»ºæµ‹è¯•ç¯å¢ƒ
docker-compose -f test-environment.yml up -d

# 3. å¯¼å…¥æµ‹è¯•æ•°æ®
docker exec -i test-mysql mysql -u root -p test_db < test_data.sql
```

### 6.2 åŠŸèƒ½æµ‹è¯•éªŒè¯


**å…³é”®åŠŸèƒ½æµ‹è¯•æ¸…å•**

```
ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼š
âœ… ç”¨æˆ·èƒ½æ­£å¸¸ç™»å½•
âœ… ç™»å½•çŠ¶æ€æ­£ç¡®ä¿æŒ
âœ… é€€å‡ºåŠŸèƒ½æ­£å¸¸

æ•°æ®æ“ä½œåŠŸèƒ½ï¼š
âœ… æ•°æ®åˆ›å»ºåŠŸèƒ½æ­£å¸¸
âœ… æ•°æ®æŸ¥è¯¢ç»“æœæ­£ç¡®
âœ… æ•°æ®æ›´æ–°åŠŸèƒ½æ­£å¸¸
âœ… æ•°æ®åˆ é™¤åŠŸèƒ½æ­£å¸¸

ä¸šåŠ¡æµç¨‹åŠŸèƒ½ï¼š
âœ… è®¢å•åˆ›å»ºæµç¨‹å®Œæ•´
âœ… æ”¯ä»˜æµç¨‹æ­£å¸¸
âœ… é€šçŸ¥å‘é€æ­£å¸¸
```

**è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ç¤ºä¾‹**

```bash
#!/bin/bash
# åŠŸèƒ½æµ‹è¯•è‡ªåŠ¨åŒ–è„šæœ¬

echo "å¼€å§‹åŠŸèƒ½æµ‹è¯•..."

# æµ‹è¯•ç”¨æˆ·ç™»å½•
login_result=$(curl -s -X POST \
    -H "Content-Type: application/json" \
    -d '{"username":"test","password":"test123"}' \
    http://test-app:8080/api/login)

if echo $login_result | grep -q "success"; then
    echo "âœ… ç™»å½•æµ‹è¯•é€šè¿‡"
else
    echo "âŒ ç™»å½•æµ‹è¯•å¤±è´¥"
    exit 1
fi

# æµ‹è¯•æ•°æ®æŸ¥è¯¢
query_result=$(curl -s http://test-app:8080/api/users)
if echo $query_result | grep -q "users"; then
    echo "âœ… æ•°æ®æŸ¥è¯¢æµ‹è¯•é€šè¿‡"
else
    echo "âŒ æ•°æ®æŸ¥è¯¢æµ‹è¯•å¤±è´¥"
    exit 1
fi

echo "æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡"
```

### 6.3 æ€§èƒ½æµ‹è¯•éªŒè¯


**æ€§èƒ½åŸºå‡†æµ‹è¯•**

```bash
# ä½¿ç”¨ wrk è¿›è¡Œå‹åŠ›æµ‹è¯•
# å®‰è£… wrk
sudo apt install wrk

# åŸºå‡†æ€§èƒ½æµ‹è¯•ï¼ˆè¿ç§»å‰ï¼‰
echo "æµ‹è¯•åŸç³»ç»Ÿæ€§èƒ½..."
wrk -t4 -c100 -d30s http://old-app:8080/api/test

# è¾“å‡ºç¤ºä¾‹ï¼š
# Running 30s test @ http://old-app:8080/api/test
#   4 threads and 100 connections
#   Thread Stats   Avg      Stdev     Max   +/- Stdev
#     Latency    45.32ms   12.15ms  156.18ms   89.23%
#     Req/Sec   552.30     89.12     789.00     76.89%
#   66276 requests in 30.00s, 15.23MB read
# Requests/sec: 2209.20
# Transfer/sec: 520.16KB

# å®¹å™¨åŒ–åæ€§èƒ½æµ‹è¯•
echo "æµ‹è¯•å®¹å™¨åŒ–åæ€§èƒ½..."
wrk -t4 -c100 -d30s http://new-app:8080/api/test
```

**æ€§èƒ½å¯¹æ¯”åˆ†æ**

| æŒ‡æ ‡ | åŸç³»ç»Ÿ | å®¹å™¨åŒ–å | å˜åŒ– | æ˜¯å¦å¯æ¥å— |
|------|--------|----------|------|------------|
| **å¹³å‡å“åº”æ—¶é—´** | 45ms | 52ms | +15% | âœ… å¯æ¥å— |
| **ååé‡(QPS)** | 2209 | 2103 | -5% | âœ… å¯æ¥å— |
| **CPUä½¿ç”¨ç‡** | 65% | 70% | +8% | âœ… å¯æ¥å— |
| **å†…å­˜ä½¿ç”¨** | 2.1GB | 2.3GB | +10% | âœ… å¯æ¥å— |

> ğŸ’¡ **æ€§èƒ½åˆ¤æ–­æ ‡å‡†**ï¼šä¸€èˆ¬è®¤ä¸ºæ€§èƒ½ä¸‹é™åœ¨20%ä»¥å†…æ˜¯å¯æ¥å—çš„

### 6.4 æ•°æ®ä¸€è‡´æ€§éªŒè¯


**æ•°æ®æ ¡éªŒæ–¹æ³•**

```bash
# 1. è®°å½•æ€»æ•°æ ¡éªŒ
echo "æ ¡éªŒæ•°æ®æ€»æ•°..."
old_count=$(mysql -h old-db -u root -p -e "SELECT COUNT(*) FROM users" | tail -1)
new_count=$(docker exec mysql-container mysql -e "SELECT COUNT(*) FROM users" | tail -1)

if [ "$old_count" = "$new_count" ]; then
    echo "âœ… æ•°æ®æ€»æ•°ä¸€è‡´: $old_count"
else
    echo "âŒ æ•°æ®æ€»æ•°ä¸ä¸€è‡´: åŸç³»ç»Ÿ=$old_count, æ–°ç³»ç»Ÿ=$new_count"
fi

# 2. æ•°æ®å†…å®¹æ ¡éªŒ
echo "æ ¡éªŒæ•°æ®å†…å®¹..."
# è®¡ç®—å…³é”®å­—æ®µçš„æ ¡éªŒå’Œ
old_checksum=$(mysql -h old-db -u root -p -e "SELECT MD5(GROUP_CONCAT(id, email ORDER BY id)) FROM users" | tail -1)
new_checksum=$(docker exec mysql-container mysql -e "SELECT MD5(GROUP_CONCAT(id, email ORDER BY id)) FROM users" | tail -1)

if [ "$old_checksum" = "$new_checksum" ]; then
    echo "âœ… æ•°æ®å†…å®¹ä¸€è‡´"
else
    echo "âŒ æ•°æ®å†…å®¹ä¸ä¸€è‡´"
fi
```

---

## 7. ğŸ”„ è¿ç§»å›æ»šè®¡åˆ’


### 7.1 å›æ»šç­–ç•¥è®¾è®¡


**ä»€ä¹ˆæ—¶å€™éœ€è¦å›æ»šï¼Ÿ**

```
å›æ»šè§¦å‘æ¡ä»¶ï¼š
ğŸš¨ ä¸¥é‡åŠŸèƒ½æ•…éšœ â†’ æ ¸å¿ƒä¸šåŠ¡æ— æ³•ä½¿ç”¨
ğŸš¨ æ•°æ®ä¸¢å¤±é£é™© â†’ å‘ç°æ•°æ®ä¸ä¸€è‡´æˆ–ä¸¢å¤±
ğŸš¨ æ€§èƒ½ä¸¥é‡ä¸‹é™ â†’ å“åº”æ—¶é—´è¶…è¿‡å¯æ¥å—èŒƒå›´
ğŸš¨ å®‰å…¨é—®é¢˜ â†’ å‘ç°å®‰å…¨æ¼æ´æˆ–æ”»å‡»
ğŸš¨ ä¾èµ–æœåŠ¡æ•…éšœ â†’ å…³é”®ä¾èµ–æœåŠ¡ä¸å¯ç”¨
```

**å›æ»šå†³ç­–æµç¨‹**

```
æ­¥éª¤1ï¼šé—®é¢˜ç¡®è®¤ (5åˆ†é’Ÿå†…)
æ˜¯å¦ä¸ºä¸¥é‡é—®é¢˜ï¼Ÿ
â”œâ”€ æ˜¯ â†’ è¿›å…¥åº”æ€¥å“åº”
â””â”€ å¦ â†’ å°è¯•ä¿®å¤

æ­¥éª¤2ï¼šä¿®å¤å°è¯• (15åˆ†é’Ÿå†…)
èƒ½å¦å¿«é€Ÿä¿®å¤ï¼Ÿ
â”œâ”€ æ˜¯ â†’ å®æ–½ä¿®å¤
â””â”€ å¦ â†’ æ‰§è¡Œå›æ»š

æ­¥éª¤3ï¼šå›æ»šå†³å®š (20åˆ†é’Ÿå†…)
ç¡®è®¤æ‰§è¡Œå›æ»š
â”œâ”€ é€šçŸ¥ç›¸å…³äººå‘˜
â”œâ”€ å¯åŠ¨å›æ»šç¨‹åº
â””â”€ ç›‘æ§å›æ»šè¿‡ç¨‹
```

### 7.2 åº”ç”¨æœåŠ¡å›æ»š


**å¿«é€Ÿå›æ»šæ–¹æ¡ˆ**

```bash
#!/bin/bash
# åº”ç”¨æœåŠ¡å¿«é€Ÿå›æ»šè„šæœ¬

echo "å¼€å§‹åº”ç”¨æœåŠ¡å›æ»š..."

# 1. ä¿å­˜å½“å‰çŠ¶æ€ï¼ˆç”¨äºæ•…éšœåˆ†æï¼‰
docker logs new-app > /tmp/failed-app.log 2>&1
docker inspect new-app > /tmp/failed-app-inspect.json

# 2. åœæ­¢æ–°ç‰ˆæœ¬åº”ç”¨
echo "åœæ­¢æ–°ç‰ˆæœ¬åº”ç”¨..."
docker stop new-app

# 3. å¯åŠ¨æ—§ç‰ˆæœ¬åº”ç”¨
echo "å¯åŠ¨æ—§ç‰ˆæœ¬åº”ç”¨..."
docker start old-app

# 4. éªŒè¯æœåŠ¡çŠ¶æ€
echo "éªŒè¯æœåŠ¡çŠ¶æ€..."
sleep 10  # ç­‰å¾…æœåŠ¡å¯åŠ¨

# å¥åº·æ£€æŸ¥
if curl -f http://localhost:8080/health > /dev/null 2>&1; then
    echo "âœ… åº”ç”¨æœåŠ¡å›æ»šæˆåŠŸ"
else
    echo "âŒ åº”ç”¨æœåŠ¡å›æ»šå¤±è´¥ï¼Œéœ€è¦äººå·¥å¹²é¢„"
    exit 1
fi

# 5. æ›´æ–°è´Ÿè½½å‡è¡¡é…ç½®
# æ ¹æ®å®é™…è´Ÿè½½å‡è¡¡å™¨é…ç½®ç›¸åº”çš„å›æ»šæ“ä½œ

echo "åº”ç”¨æœåŠ¡å›æ»šå®Œæˆ"
```

**è“ç»¿éƒ¨ç½²å›æ»š**

```bash
# è“ç»¿éƒ¨ç½²çš„å›æ»šæ›´ç®€å•ï¼šåªéœ€è¦åˆ‡æ¢æµé‡æŒ‡å‘

# å½“å‰çŠ¶æ€ï¼šæµé‡æŒ‡å‘ç»¿ç¯å¢ƒï¼ˆæ–°ç‰ˆæœ¬ï¼‰
# ç»¿ç¯å¢ƒæœ‰é—®é¢˜ï¼Œéœ€è¦åˆ‡æ¢å›è“ç¯å¢ƒï¼ˆæ—§ç‰ˆæœ¬ï¼‰

# 1. ä¿®æ”¹è´Ÿè½½å‡è¡¡é…ç½®ï¼ˆä»¥Nginxä¸ºä¾‹ï¼‰
# å°†upstreamæŒ‡å‘è“ç¯å¢ƒ
sed -i 's/server green-app:8080/server blue-app:8080/' /etc/nginx/conf.d/default.conf

# 2. é‡è½½Nginxé…ç½®
nginx -s reload

# 3. éªŒè¯åˆ‡æ¢ç»“æœ
curl http://localhost/version  # åº”è¯¥è¿”å›æ—§ç‰ˆæœ¬å·
```

### 7.3 æ•°æ®åº“å›æ»š


**æ•°æ®åº“å›æ»šæœ€å¤æ‚ï¼Œéœ€è¦è°¨æ…å¤„ç†**

**åœºæ™¯1ï¼šåªè¯»æ•°æ®è¿ç§»å¤±è´¥**

```bash
# å¦‚æœæ˜¯åªè¯»æ•°æ®ï¼ˆå¦‚é…ç½®æ•°æ®ã€å­—å…¸æ•°æ®ï¼‰
# å›æ»šç›¸å¯¹ç®€å•

# 1. åœæ­¢æ–°æ•°æ®åº“
docker stop mysql-new

# 2. å¯åŠ¨æ—§æ•°æ®åº“
systemctl start mysql-old

# 3. æ›´æ–°åº”ç”¨è¿æ¥é…ç½®
# ä¿®æ”¹æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²æŒ‡å‘æ—§æ•°æ®åº“

# 4. é‡å¯åº”ç”¨
docker restart myapp
```

**åœºæ™¯2ï¼šæœ‰æ–°æ•°æ®å†™å…¥çš„å›æ»š**

```bash
# è¿™ç§æƒ…å†µæœ€å¤æ‚ï¼Œå› ä¸ºæ–°ç³»ç»Ÿå¯èƒ½å·²ç»äº§ç”Ÿäº†æ–°æ•°æ®

# 1. ç«‹å³åœæ­¢åº”ç”¨å†™å…¥
docker stop myapp

# 2. å¤‡ä»½æ–°ç³»ç»Ÿä¸­çš„å¢é‡æ•°æ®
docker exec mysql-new mysqldump \
    --where="created_time > '2024-09-17 10:00:00'" \
    myapp_db > incremental_data.sql

# 3. å¯åŠ¨æ—§æ•°æ®åº“
systemctl start mysql-old

# 4. å¦‚æœå¯èƒ½ï¼Œå°†å¢é‡æ•°æ®å¯¼å…¥æ—§ç³»ç»Ÿ
# ï¼ˆéœ€è¦ç¡®ä¿æ•°æ®ç»“æ„å…¼å®¹ï¼‰
mysql -h old-mysql -u root -p myapp_db < incremental_data.sql

# 5. é‡æ–°å¯åŠ¨åº”ç”¨
docker restart myapp
```

### 7.4 å›æ»šéªŒè¯ä¸ç›‘æ§


**å›æ»šåçš„éªŒè¯æ­¥éª¤**

```bash
#!/bin/bash
# å›æ»šéªŒè¯è„šæœ¬

echo "å¼€å§‹å›æ»šéªŒè¯..."

# 1. æœåŠ¡å¯ç”¨æ€§éªŒè¯
if curl -f http://localhost:8080/health; then
    echo "âœ… æœåŠ¡å¯ç”¨æ€§æ­£å¸¸"
else
    echo "âŒ æœåŠ¡ä¸å¯ç”¨"
    exit 1
fi

# 2. å…³é”®åŠŸèƒ½éªŒè¯
login_test=$(curl -s -X POST \
    -d '{"user":"test","pass":"test"}' \
    http://localhost:8080/login)
    
if echo $login_test | grep -q "success"; then
    echo "âœ… ç™»å½•åŠŸèƒ½æ­£å¸¸"
else
    echo "âŒ ç™»å½•åŠŸèƒ½å¼‚å¸¸"
fi

# 3. æ•°æ®å®Œæ•´æ€§éªŒè¯
user_count=$(mysql -e "SELECT COUNT(*) FROM users" | tail -1)
echo "ğŸ“Š ç”¨æˆ·æ•°æ®æ€»æ•°: $user_count"

# 4. æ€§èƒ½ç®€å•éªŒè¯
response_time=$(curl -w "%{time_total}" -s http://localhost:8080/api/test)
echo "ğŸ“ˆ å“åº”æ—¶é—´: ${response_time}s"

echo "å›æ»šéªŒè¯å®Œæˆ"
```

**å›æ»šåç›‘æ§é‡ç‚¹**

| ç›‘æ§é¡¹ç›® | æ­£å¸¸èŒƒå›´ | å‘Šè­¦é˜ˆå€¼ | å¤„ç†æªæ–½ |
|----------|----------|----------|----------|
| **å“åº”æ—¶é—´** | < 100ms | > 200ms | æ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µ |
| **é”™è¯¯ç‡** | < 1% | > 5% | æŸ¥çœ‹é”™è¯¯æ—¥å¿— |
| **CPUä½¿ç”¨** | < 80% | > 90% | æ£€æŸ¥è¿›ç¨‹çŠ¶æ€ |
| **å†…å­˜ä½¿ç”¨** | < 85% | > 95% | æ£€æŸ¥å†…å­˜æ³„æ¼ |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„è¿ç§»åŸåˆ™


```
ğŸ”¸ åˆ†æ­¥è¿ç§»ï¼šä¸è¦ä¸€æ¬¡æ€§è¿ç§»æ‰€æœ‰ç»„ä»¶ï¼Œåˆ†æ‰¹åˆ†æ­¥è¿›è¡Œ
ğŸ”¸ ä¿ç•™åŸç¯å¢ƒï¼šè¿ç§»æˆåŠŸä¹‹å‰ï¼Œä¿æŒåŸç¯å¢ƒå¯éšæ—¶å¯ç”¨
ğŸ”¸ å……åˆ†æµ‹è¯•ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå®Œæ•´éªŒè¯è¿ç§»è¿‡ç¨‹
ğŸ”¸ æ•°æ®ä¸ºé‡ï¼šä»»ä½•æ“ä½œéƒ½è¦ç¡®ä¿æ•°æ®å®‰å…¨å’Œä¸€è‡´æ€§
ğŸ”¸ ç›‘æ§å…ˆè¡Œï¼šè¿ç§»è¿‡ç¨‹ä¸­æŒç»­ç›‘æ§å…³é”®æŒ‡æ ‡
ğŸ”¸ å¿«é€Ÿå›æ»šï¼šåˆ¶å®šè¯¦ç»†çš„å›æ»šè®¡åˆ’å¹¶è¿›è¡Œæ¼”ç»ƒ
```

### 8.2 è¿ç§»æˆåŠŸçš„å…³é”®è¦ç´ 


**ğŸ”¹ æŠ€æœ¯å‡†å¤‡å……åˆ†**
```
ç¯å¢ƒåˆ†æï¼š
- æ¸…æ¥šäº†è§£ç°æœ‰åº”ç”¨çš„æ¶æ„å’Œä¾èµ–
- è¯†åˆ«æœ‰çŠ¶æ€å’Œæ— çŠ¶æ€ç»„ä»¶
- è¯„ä¼°æ€§èƒ½å’Œèµ„æºéœ€æ±‚

æŠ€æœ¯é€‰å‹ï¼š
- é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ
- è®¾è®¡åˆç†çš„å®¹å™¨æ¶æ„
- è§„åˆ’ç½‘ç»œå’Œå­˜å‚¨æ–¹æ¡ˆ
```

**ğŸ”¹ é£é™©æ§åˆ¶åˆ°ä½**
```
é£é™©è¯†åˆ«ï¼š
- æå‰è¯†åˆ«å¯èƒ½çš„é£é™©ç‚¹
- åˆ¶å®šé’ˆå¯¹æ€§çš„é¢„é˜²æªæ–½
- å‡†å¤‡åº”æ€¥å¤„ç†é¢„æ¡ˆ

æµ‹è¯•éªŒè¯ï¼š
- åŠŸèƒ½æµ‹è¯•ç¡®ä¿ä¸šåŠ¡æ­£å¸¸
- æ€§èƒ½æµ‹è¯•ç¡®ä¿ç”¨æˆ·ä½“éªŒ
- æ•°æ®ä¸€è‡´æ€§æµ‹è¯•ç¡®ä¿ä¿¡æ¯å‡†ç¡®
```

**ğŸ”¹ è¿ç»´ä¿éšœæœ‰åŠ›**
```
ç›‘æ§ä½“ç³»ï¼š
- å®æ—¶ç›‘æ§åº”ç”¨çŠ¶æ€
- åŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜
- ä¿æŒæœåŠ¡ç¨³å®šè¿è¡Œ

å›æ»šæœºåˆ¶ï¼š
- å¿«é€Ÿå›æ»šç¨‹åº
- æ˜ç¡®å›æ»šè§¦å‘æ¡ä»¶
- å®šæœŸæ¼”ç»ƒå›æ»šæµç¨‹
```

### 8.3 å¸¸è§è¯¯åŒºä¸é¿å…


**âŒ å¸¸è§é”™è¯¯**
- **ä¸€æ¬¡æ€§å…¨è¿ç§»**ï¼šé£é™©å¤ªå¤§ï¼Œé—®é¢˜å®šä½å›°éš¾
- **å¿½ç•¥æ•°æ®å¤‡ä»½**ï¼šæ•°æ®ä¸¢å¤±åæœä¸å¯æŒ½å›
- **æµ‹è¯•ä¸å……åˆ†**ï¼šç”Ÿäº§é—®é¢˜æš´éœ²åä¿®å¤æˆæœ¬é«˜
- **æ²¡æœ‰å›æ»šè®¡åˆ’**ï¼šå‡ºé—®é¢˜æ—¶æ‰‹å¿™è„šä¹±

**âœ… æ­£ç¡®åšæ³•**
- **åˆ†æ‰¹åˆ†æ­¥è¿ç§»**ï¼šé™ä½é£é™©ï¼Œä¾¿äºé—®é¢˜å®šä½
- **å¤šé‡æ•°æ®å¤‡ä»½**ï¼šæœ¬åœ°å¤‡ä»½+è¿œç¨‹å¤‡ä»½+å®æ—¶åŒæ­¥
- **å…¨é¢æµ‹è¯•éªŒè¯**ï¼šåŠŸèƒ½+æ€§èƒ½+å‹åŠ›+å¼‚å¸¸æµ‹è¯•
- **è¯¦ç»†å›æ»šé¢„æ¡ˆ**ï¼šè‡ªåŠ¨åŒ–è„šæœ¬+äººå·¥éªŒè¯+ç›‘æ§å‘Šè­¦

### 8.4 å®æˆ˜ç»éªŒåˆ†äº«


**ğŸ¯ è¿ç§»æœ€ä½³å®è·µ**
- **ä»ç®€å•å¼€å§‹**ï¼šå…ˆè¿ç§»æ— çŠ¶æ€çš„Webåº”ç”¨ï¼Œç§¯ç´¯ç»éªŒ
- **ä¿å®ˆè¯„ä¼°**ï¼šæ€§èƒ½é¢„æœŸä¿å®ˆä¸€äº›ï¼Œé¿å…è¿‡åº¦ä¹è§‚
- **å›¢é˜Ÿåä½œ**ï¼šå¼€å‘ã€è¿ç»´ã€æµ‹è¯•å¯†åˆ‡é…åˆ
- **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†è®°å½•è¿ç§»è¿‡ç¨‹ï¼Œä¾¿äºåç»­å‚è€ƒ

**ğŸ’¡ é—®é¢˜æ’æŸ¥æŠ€å·§**
- **æ—¥å¿—å…ˆè¡Œ**ï¼šé—®é¢˜å‡ºç°æ—¶ï¼Œç¬¬ä¸€æ—¶é—´æŸ¥çœ‹æ—¥å¿—
- **å¯¹æ¯”åˆ†æ**ï¼šä¸åŸç³»ç»Ÿå¯¹æ¯”ï¼Œæ‰¾å‡ºå·®å¼‚ç‚¹
- **é€æ­¥æ’é™¤**ï¼šä»ç½‘ç»œåˆ°å­˜å‚¨ï¼Œä»é…ç½®åˆ°ä»£ç ï¼Œé€æ­¥æ’æŸ¥
- **å›æ»šå†³æ–­**ï¼šæ— æ³•å¿«é€Ÿå®šä½é—®é¢˜æ—¶ï¼Œæœæ–­å›æ»š

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> è¿ç§»å®¹å™¨è¦è°¨æ…ï¼Œåˆ†æ­¥æµ‹è¯•ä¿å®‰å…¨  
> æ•°æ®å¤‡ä»½æ˜¯æ ¹æœ¬ï¼Œç›‘æ§å›æ»šä¸å¯ç¼º  
> æœ‰çŠ¶æ€åº”ç”¨éœ€ç‰¹æ®Šï¼Œæ— çŠ¶æ€è¿ç§»ç›¸å¯¹æ˜“  
> é£é™©è¯„ä¼°è¦å…¨é¢ï¼ŒæˆåŠŸè¿ç§»æœ‰ç« æ³•