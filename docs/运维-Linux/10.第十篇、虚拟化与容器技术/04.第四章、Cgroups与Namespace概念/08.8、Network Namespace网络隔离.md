---
title: 8ã€Network Namespaceç½‘ç»œéš”ç¦»
---
## ğŸ“š ç›®å½•

1. [ç½‘ç»œå‘½åç©ºé—´åŸºç¡€æ¦‚å¿µ](#1-ç½‘ç»œå‘½åç©ºé—´åŸºç¡€æ¦‚å¿µ)
2. [ç½‘ç»œéš”ç¦»èŒƒå›´ä¸åŸç†](#2-ç½‘ç»œéš”ç¦»èŒƒå›´ä¸åŸç†)
3. [è™šæ‹Ÿç½‘ç»œæ¥å£æŠ€æœ¯](#3-è™šæ‹Ÿç½‘ç»œæ¥å£æŠ€æœ¯)
4. [veth pairè™šæ‹Ÿç½‘å¡å¯¹](#4-veth-pairè™šæ‹Ÿç½‘å¡å¯¹)
5. [namespaceé—´é€šä¿¡æœºåˆ¶](#5-namespaceé—´é€šä¿¡æœºåˆ¶)
6. [è·¯ç”±ä¸é˜²ç«å¢™éš”ç¦»](#6-è·¯ç”±ä¸é˜²ç«å¢™éš”ç¦»)
7. [ç½‘æ¡¥è¿æ¥æŠ€æœ¯](#7-ç½‘æ¡¥è¿æ¥æŠ€æœ¯)
8. [IPåœ°å€åˆ†é…ç®¡ç†](#8-IPåœ°å€åˆ†é…ç®¡ç†)
9. [æ•…éšœæ’æŸ¥ä¸è°ƒè¯•](#9-æ•…éšœæ’æŸ¥ä¸è°ƒè¯•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ç½‘ç»œå‘½åç©ºé—´åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Network Namespace


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
> **Network Namespace**ï¼šæ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ç§ç½‘ç»œèµ„æºéš”ç¦»æŠ€æœ¯ï¼Œå¯ä»¥åˆ›å»ºå®Œå…¨ç‹¬ç«‹çš„ç½‘ç»œç¯å¢ƒï¼Œæ¯ä¸ªç½‘ç»œå‘½åç©ºé—´éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç½‘ç»œåè®®æ ˆã€‚

**ğŸ’¡ é€šä¿—ç†è§£**
æŠŠNetwork Namespaceæƒ³è±¡æˆ**ç‹¬ç«‹çš„å°æˆ¿é—´**ï¼š
- æ¯ä¸ªæˆ¿é—´éƒ½æœ‰è‡ªå·±çš„ç½‘ç»œè®¾å¤‡ï¼ˆç½‘å¡ã€è·¯ç”±å™¨ï¼‰
- æˆ¿é—´ä¹‹é—´é»˜è®¤æ— æ³•äº’ç›¸é€šä¿¡
- éœ€è¦ç‰¹æ®Šçš„"é€šé“"æ‰èƒ½è¿æ¥ä¸åŒæˆ¿é—´

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œéš”ç¦»


**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

| **é—®é¢˜åœºæ™¯** | **ä¼ ç»Ÿæ–¹å¼** | **Network Namespaceè§£å†³æ–¹æ¡ˆ** |
|-------------|-------------|------------------------------|
| **å¤šæœåŠ¡ç«¯å£å†²çª** | `ä¿®æ”¹é…ç½®æ–‡ä»¶é¿å…å†²çª` | `æ¯ä¸ªæœåŠ¡ç‹¬ç«‹ç½‘ç»œç©ºé—´` |
| **ç½‘ç»œé…ç½®äº’ç›¸å½±å“** | `å°å¿ƒç¿¼ç¿¼é…ç½®è·¯ç”±` | `å®Œå…¨éš”ç¦»çš„ç½‘ç»œæ ˆ` |
| **å®‰å…¨æ€§ä¸è¶³** | `é˜²ç«å¢™è§„åˆ™å¤æ‚` | `å¤©ç„¶ç½‘ç»œéš”ç¦»` |
| **æµ‹è¯•ç¯å¢ƒæ¨¡æ‹Ÿ** | `éœ€è¦å¤šå°ç‰©ç†æœºå™¨` | `ä¸€å°æœºå™¨æ¨¡æ‹Ÿå¤šç½‘ç»œç¯å¢ƒ` |

### 1.3 Network Namespaceçš„åº”ç”¨åœºæ™¯


**ğŸš€ å®é™…åº”ç”¨é¢†åŸŸ**
```
Network Namespaceåº”ç”¨åœºæ™¯å›¾ï¼š

        å®¹å™¨æŠ€æœ¯(Docker/K8s)
               â†—
ç½‘ç»œè™šæ‹ŸåŒ– â†â†’ Network Namespace â†â†’ ç½‘ç»œæµ‹è¯•ç¯å¢ƒ
               â†˜
        å¤šç§Ÿæˆ·ç½‘ç»œéš”ç¦»
```

- **å®¹å™¨æŠ€æœ¯**ï¼šDockeræ¯ä¸ªå®¹å™¨éƒ½æœ‰ç‹¬ç«‹çš„ç½‘ç»œç©ºé—´
- **è™šæ‹ŸåŒ–**ï¼šäº‘å¹³å°ä¸ºä¸åŒç§Ÿæˆ·æä¾›ç½‘ç»œéš”ç¦»
- **å¼€å‘æµ‹è¯•**ï¼šæ¨¡æ‹Ÿå¤æ‚ç½‘ç»œæ‹“æ‰‘è¿›è¡Œæµ‹è¯•
- **å®‰å…¨éš”ç¦»**ï¼šå°†ä¸åŒå®‰å…¨çº§åˆ«çš„åº”ç”¨éš”ç¦»

---

## 2. ğŸ”’ ç½‘ç»œéš”ç¦»èŒƒå›´ä¸åŸç†


### 2.1 éš”ç¦»çš„ç½‘ç»œèµ„æº


**ğŸ“‹ å®Œæ•´éš”ç¦»æ¸…å•**

```
Network Namespaceéš”ç¦»çš„ç½‘ç»œèµ„æºï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ç½‘ç»œåè®®æ ˆéš”ç¦»                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç‰©ç†èµ„æº   â”‚        é€»è¾‘èµ„æº           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ ç½‘ç»œæ¥å£   â”‚â€¢ IPåœ°å€                   â”‚
â”‚â€¢ è·¯ç”±è¡¨     â”‚â€¢ ç«¯å£å·ç©ºé—´               â”‚
â”‚â€¢ ARPè¡¨      â”‚â€¢ socketè¿æ¥               â”‚
â”‚â€¢ ç½‘ç»œè®¾å¤‡   â”‚â€¢ iptablesè§„åˆ™             â”‚
â”‚             â”‚â€¢ /proc/netç›®å½•            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 éš”ç¦»åŸç†æ·±åº¦è§£æ


**ğŸ” å†…æ ¸å±‚é¢çš„éš”ç¦»æœºåˆ¶**

æ¯ä¸ªNetwork Namespaceç»´æŠ¤ç‹¬ç«‹çš„ï¼š
- **ç½‘ç»œæ¥å£åˆ—è¡¨**ï¼šçœ‹åˆ°çš„ç½‘å¡å®Œå…¨ä¸åŒ
- **è·¯ç”±è¡¨**ï¼šæ•°æ®åŒ…è½¬å‘è§„åˆ™ç‹¬ç«‹
- **é˜²ç«å¢™è§„åˆ™**ï¼šiptablesè§„åˆ™äº’ä¸å½±å“  
- **ç½‘ç»œç»Ÿè®¡ä¿¡æ¯**ï¼šå„è‡ªçš„ç½‘ç»œæµé‡ç»Ÿè®¡
- **socketç»‘å®š**ï¼šåŒä¸€ç«¯å£å¯ä»¥åœ¨ä¸åŒnamespaceä¸­é‡å¤ä½¿ç”¨

**ğŸ’­ å®é™…å·¥ä½œè¿‡ç¨‹**
```
æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼š

åº”ç”¨ç¨‹åºå‘é€æ•°æ®
        â†“
å½“å‰namespaceçš„ç½‘ç»œåè®®æ ˆ
        â†“
æŸ¥è¯¢å½“å‰namespaceçš„è·¯ç”±è¡¨
        â†“
ä»å½“å‰namespaceçš„ç½‘ç»œæ¥å£å‘å‡º
```

### 2.3 ä¸å…¶ä»–namespaceçš„å…³ç³»


**ğŸ”— namespaceå®¶æ—å…³ç³»**

| **Namespaceç±»å‹** | **éš”ç¦»èµ„æº** | **ä¸Network Namespaceå…³ç³»** |
|-------------------|-------------|----------------------------|
| **PID Namespace** | `è¿›ç¨‹IDç©ºé—´` | `è¿›ç¨‹å¯ä»¥ç»‘å®šåˆ°ç‰¹å®šç½‘ç»œç©ºé—´` |
| **User Namespace** | `ç”¨æˆ·æƒé™` | `æ§åˆ¶ç½‘ç»œæ“ä½œæƒé™` |
| **Mount Namespace** | `æ–‡ä»¶ç³»ç»ŸæŒ‚è½½` | `/proc/netç›®å½•å†…å®¹ä¸åŒ` |
| **UTS Namespace** | `ä¸»æœºå` | `æ¯ä¸ªç½‘ç»œç©ºé—´å¯æœ‰ä¸åŒä¸»æœºå` |

---

## 3. ğŸ”Œ è™šæ‹Ÿç½‘ç»œæ¥å£æŠ€æœ¯


### 3.1 è™šæ‹Ÿç½‘ç»œæ¥å£æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯è™šæ‹Ÿç½‘ç»œæ¥å£**
è™šæ‹Ÿç½‘ç»œæ¥å£æ˜¯**è½¯ä»¶æ¨¡æ‹Ÿçš„ç½‘å¡è®¾å¤‡**ï¼Œå°±åƒåœ¨ç”µè„‘ä¸Šå®‰è£…è™šæ‹Ÿç½‘å¡é©±åŠ¨ï¼š
- **ç‰©ç†ç½‘å¡**ï¼šçœŸå®çš„ç¡¬ä»¶è®¾å¤‡ï¼Œæ¯”å¦‚ä»¥å¤ªç½‘å¡
- **è™šæ‹Ÿç½‘å¡**ï¼šè½¯ä»¶åˆ›å»ºçš„ç½‘ç»œæ¥å£ï¼ŒåŠŸèƒ½ä¸ç‰©ç†ç½‘å¡ç±»ä¼¼

### 3.2 å¸¸è§è™šæ‹Ÿç½‘ç»œæ¥å£ç±»å‹


**ğŸ“Š è™šæ‹Ÿæ¥å£ç±»å‹å¯¹æ¯”**

| **æ¥å£ç±»å‹** | **ç”¨é€”è¯´æ˜** | **å…¸å‹åº”ç”¨** | **ç‰¹ç‚¹** |
|-------------|-------------|-------------|---------|
| **lo (loopback)** | `æœ¬åœ°å›ç¯æ¥å£` | `127.0.0.1é€šä¿¡` | `æ¯ä¸ªnamespaceéƒ½æœ‰` |
| **veth** | `è™šæ‹Ÿç½‘å¡å¯¹` | `å®¹å™¨é—´é€šä¿¡` | `æˆå¯¹å‡ºç°ï¼Œæ•°æ®äº’é€š` |
| **bridge** | `è™šæ‹Ÿç½‘æ¡¥` | `å¤šæ¥å£è¿æ¥` | `ç±»ä¼¼ç‰©ç†äº¤æ¢æœº` |
| **tun/tap** | `éš§é“æ¥å£` | `VPNè¿æ¥` | `ç”¨æˆ·ç©ºé—´æ•°æ®å¤„ç†` |

### 3.3 è™šæ‹Ÿæ¥å£åˆ›å»ºä¸ç®¡ç†


**âš¡ åŸºæœ¬æ“ä½œå‘½ä»¤**

```bash
# æŸ¥çœ‹å½“å‰ç½‘ç»œæ¥å£
ip link show

# åˆ›å»ºè™šæ‹Ÿæ¥å£çš„é€šç”¨è¯­æ³•
ip link add <æ¥å£å> type <ç±»å‹> [å‚æ•°]

# å¯ç”¨/ç¦ç”¨ç½‘ç»œæ¥å£
ip link set <æ¥å£å> up
ip link set <æ¥å£å> down

# åˆ é™¤è™šæ‹Ÿæ¥å£
ip link delete <æ¥å£å>
```

**ğŸ¯ å®é™…æ“ä½œç¤ºä¾‹**
```bash
# æŸ¥çœ‹é»˜è®¤ç½‘ç»œç©ºé—´çš„æ¥å£
ip link show
# è¾“å‡ºï¼š1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536
#      2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500
```

---

## 4. ğŸ”— veth pairè™šæ‹Ÿç½‘å¡å¯¹


### 4.1 veth pairæ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯veth pair**
veth pairå°±åƒ**ä¸€æ ¹ç½‘çº¿çš„ä¸¤ç«¯**ï¼š
- åˆ›å»ºæ—¶æ€»æ˜¯æˆå¯¹å‡ºç°ï¼ˆveth0 å’Œ veth1ï¼‰
- ä¸€ç«¯å‘é€çš„æ•°æ®ä¼šç›´æ¥å‡ºç°åœ¨å¦ä¸€ç«¯
- ä¸¤ç«¯å¯ä»¥åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ä¸­

**ğŸ’¡ ç”Ÿæ´»åŒ–ç±»æ¯”**
æƒ³è±¡veth pairæ˜¯ä¸€ä¸ª**å¯¹è®²æœº**ï¼š
- å¯¹è®²æœºAè¯´è¯ï¼Œå¯¹è®²æœºBèƒ½å¬åˆ°
- å¯¹è®²æœºBè¯´è¯ï¼Œå¯¹è®²æœºAèƒ½å¬åˆ°
- ä¸¤ä¸ªå¯¹è®²æœºå¯ä»¥åˆ†åˆ«ç»™ä¸åŒçš„äººä½¿ç”¨

### 4.2 veth pairå·¥ä½œåŸç†


**ğŸ”„ æ•°æ®ä¼ è¾“æµç¨‹**
```
veth pairæ•°æ®ä¼ è¾“ç¤ºæ„å›¾ï¼š

Namespace A          veth pair          Namespace B
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    veth0    â”‚ â†â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â†’ â”‚    veth1    â”‚
â”‚ 10.0.1.1/24 â”‚                        â”‚ 10.0.2.1/24 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘                                        â†‘
   åº”ç”¨ç¨‹åº                                 åº”ç”¨ç¨‹åº
```

### 4.3 åˆ›å»ºå’Œé…ç½®veth pair


**âš¡ åˆ›å»ºæ­¥éª¤è¯¦è§£**

```bash
# ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´
ip netns add ns1
ip netns add ns2

# ç¬¬äºŒæ­¥ï¼šåˆ›å»ºveth pair
ip link add veth0 type veth peer name veth1

# ç¬¬ä¸‰æ­¥ï¼šå°†vethä¸¤ç«¯åˆ†åˆ«ç§»åˆ°ä¸åŒnamespace
ip link set veth0 netns ns1
ip link set veth1 netns ns2

# ç¬¬å››æ­¥ï¼šé…ç½®IPåœ°å€å¹¶å¯ç”¨
ip netns exec ns1 ip addr add 10.0.1.1/24 dev veth0
ip netns exec ns1 ip link set veth0 up

ip netns exec ns2 ip addr add 10.0.2.1/24 dev veth1
ip netns exec ns2 ip link set veth1 up
```

### 4.4 éªŒè¯veth pairè¿é€šæ€§


**âœ… è¿é€šæ€§æµ‹è¯•**
```bash
# ä»ns1 ping ns2
ip netns exec ns1 ping 10.0.2.1

# ä»ns2 ping ns1  
ip netns exec ns2 ping 10.0.1.1

# æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶æ€
ip netns exec ns1 ip link show
ip netns exec ns2 ip link show
```

> **ğŸ’¡ é‡è¦æç¤º**ï¼šveth pairçš„ä¸¤ç«¯å¿…é¡»éƒ½è®¾ç½®ä¸ºupçŠ¶æ€ï¼Œå¦åˆ™æ— æ³•é€šä¿¡ã€‚è¿™æ˜¯åˆå­¦è€…æœ€å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ã€‚

---

## 5. ğŸ“¡ namespaceé—´é€šä¿¡æœºåˆ¶


### 5.1 é€šä¿¡æ–¹å¼æ¦‚è§ˆ


**ğŸ¯ å››ç§ä¸»è¦é€šä¿¡æ–¹å¼**

```
namespaceé—´é€šä¿¡æ–¹å¼ï¼š

        ç›´æ¥veth pairè¿æ¥
              â†—
å…±äº«ç‰©ç†æ¥å£ â†â†’ é€šä¿¡ä¸­å¿ƒ â†â†’ é€šè¿‡ç½‘æ¡¥è¿æ¥
              â†˜
         è·¯ç”±è¡¨è½¬å‘
```

| **é€šä¿¡æ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **é…ç½®å¤æ‚åº¦** | **æ€§èƒ½** |
|-------------|-------------|---------------|---------|
| **veth pairç›´è¿** | `ä¸¤ä¸ªnamespaceé€šä¿¡` | `ç®€å•` | `é«˜` |
| **ç½‘æ¡¥è¿æ¥** | `å¤šä¸ªnamespaceé€šä¿¡` | `ä¸­ç­‰` | `ä¸­é«˜` |
| **è·¯ç”±è½¬å‘** | `å¤æ‚ç½‘ç»œæ‹“æ‰‘` | `å¤æ‚` | `ä¸­ç­‰` |
| **å…±äº«ç‰©ç†æ¥å£** | `è®¿é—®å¤–ç½‘` | `ç®€å•` | `é«˜` |

### 5.2 å¤šnamespaceé€šä¿¡å®æˆ˜


**ğŸ› ï¸ ä¸‰ä¸ªnamespaceäº’è”ç¤ºä¾‹**

```bash
# åˆ›å»ºä¸‰ä¸ªç½‘ç»œå‘½åç©ºé—´
ip netns add web
ip netns add db  
ip netns add cache

# åˆ›å»ºç½‘æ¡¥ä½œä¸ºé€šä¿¡ä¸­å¿ƒ
ip link add br0 type bridge

# åˆ›å»ºä¸‰å¯¹vethï¼Œè¿æ¥å„namespaceåˆ°ç½‘æ¡¥
ip link add veth-web type veth peer name veth-web-br
ip link add veth-db type veth peer name veth-db-br
ip link add veth-cache type veth peer name veth-cache-br

# å°†ä¸€ç«¯ç§»å…¥å¯¹åº”namespace
ip link set veth-web netns web
ip link set veth-db netns db
ip link set veth-cache netns cache

# å°†å¦ä¸€ç«¯è¿æ¥åˆ°ç½‘æ¡¥
ip link set veth-web-br master br0
ip link set veth-db-br master br0  
ip link set veth-cache-br master br0

# é…ç½®IPåœ°å€å¹¶å¯ç”¨æ¥å£
ip netns exec web ip addr add 192.168.1.10/24 dev veth-web
ip netns exec web ip link set veth-web up

ip netns exec db ip addr add 192.168.1.20/24 dev veth-db
ip netns exec db ip link set veth-db up

ip netns exec cache ip addr add 192.168.1.30/24 dev veth-cache
ip netns exec cache ip link set veth-cache up

# å¯ç”¨ç½‘æ¡¥å’Œè¿æ¥æ¥å£
ip link set br0 up
ip link set veth-web-br up
ip link set veth-db-br up
ip link set veth-cache-br up
```

### 5.3 é€šä¿¡æµ‹è¯•ä¸éªŒè¯


**ğŸ” å…¨é¢è¿é€šæ€§éªŒè¯**
```bash
# web namespaceè®¿é—®å…¶ä»–æœåŠ¡
ip netns exec web ping 192.168.1.20  # è®¿é—®æ•°æ®åº“
ip netns exec web ping 192.168.1.30  # è®¿é—®ç¼“å­˜

# db namespaceè®¿é—®å…¶ä»–æœåŠ¡
ip netns exec db ping 192.168.1.10   # è®¿é—®webæœåŠ¡
ip netns exec db ping 192.168.1.30   # è®¿é—®ç¼“å­˜

# cache namespaceè®¿é—®å…¶ä»–æœåŠ¡  
ip netns exec cache ping 192.168.1.10  # è®¿é—®webæœåŠ¡
ip netns exec cache ping 192.168.1.20  # è®¿é—®æ•°æ®åº“
```

---

## 6. ğŸ›¡ï¸ è·¯ç”±ä¸é˜²ç«å¢™éš”ç¦»


### 6.1 è·¯ç”±è¡¨éš”ç¦»åŸç†


**ğŸ“‹ è·¯ç”±è¡¨çš„ç‹¬ç«‹æ€§**
æ¯ä¸ªNetwork Namespaceéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è·¯ç”±è¡¨ï¼Œè¿™æ„å‘³ç€ï¼š
- **ç›¸åŒç›®æ ‡ç½‘ç»œ**å¯ä»¥æœ‰ä¸åŒçš„è·¯ç”±è§„åˆ™
- **é»˜è®¤è·¯ç”±**å¯ä»¥æŒ‡å‘ä¸åŒçš„ç½‘å…³
- **è·¯ç”±ç­–ç•¥**å®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å½±å“

**ğŸ—‚ï¸ è·¯ç”±è¡¨æŸ¥çœ‹ä¸ç®¡ç†**
```bash
# æŸ¥çœ‹é»˜è®¤namespaceçš„è·¯ç”±è¡¨
ip route show

# æŸ¥çœ‹æŒ‡å®šnamespaceçš„è·¯ç”±è¡¨
ip netns exec ns1 ip route show

# åœ¨æŒ‡å®šnamespaceä¸­æ·»åŠ è·¯ç”±
ip netns exec ns1 ip route add 10.0.0.0/16 via 10.0.1.254

# æ·»åŠ é»˜è®¤è·¯ç”±
ip netns exec ns1 ip route add default via 10.0.1.1
```

### 6.2 é˜²ç«å¢™è§„åˆ™éš”ç¦»


**ğŸ”¥ iptablesè§„åˆ™çš„ç‹¬ç«‹æ€§**

æ¯ä¸ªNetwork Namespaceç»´æŠ¤ç‹¬ç«‹çš„netfilterè§„åˆ™ï¼š

| **è¡¨ç±»å‹** | **åŠŸèƒ½** | **éš”ç¦»æ•ˆæœ** |
|-----------|---------|-------------|
| **filterè¡¨** | `åŒ…è¿‡æ»¤` | `å„namespaceç‹¬ç«‹è¿‡æ»¤è§„åˆ™` |
| **natè¡¨** | `åœ°å€è½¬æ¢` | `ç‹¬ç«‹çš„NATè½¬æ¢è§„åˆ™` |
| **mangleè¡¨** | `åŒ…æ ‡è®°` | `ç‹¬ç«‹çš„åŒ…å¤„ç†è§„åˆ™` |
| **rawè¡¨** | `è¿æ¥è·Ÿè¸ª` | `ç‹¬ç«‹çš„è¿æ¥çŠ¶æ€` |

**âš¡ é˜²ç«å¢™é…ç½®ç¤ºä¾‹**
```bash
# åœ¨ns1ä¸­è®¾ç½®é˜²ç«å¢™è§„åˆ™
ip netns exec ns1 iptables -A INPUT -p tcp --dport 80 -j ACCEPT
ip netns exec ns1 iptables -A INPUT -p tcp --dport 22 -j DROP

# åœ¨ns2ä¸­è®¾ç½®ä¸åŒçš„é˜²ç«å¢™è§„åˆ™
ip netns exec ns2 iptables -A INPUT -p tcp --dport 22 -j ACCEPT
ip netns exec ns2 iptables -A INPUT -p tcp --dport 80 -j DROP

# æŸ¥çœ‹å„namespaceçš„iptablesè§„åˆ™
ip netns exec ns1 iptables -L
ip netns exec ns2 iptables -L
```

### 6.3 ç½‘ç»œç­–ç•¥å®æˆ˜æ¡ˆä¾‹


**ğŸ¯ æ„å»ºå®‰å…¨çš„å¤šå±‚ç½‘ç»œæ¶æ„**
```bash
# åœºæ™¯ï¼šwebå‰ç«¯ â†’ åº”ç”¨æœåŠ¡ â†’ æ•°æ®åº“
# è¦æ±‚ï¼šæ•°æ®åº“åªèƒ½è¢«åº”ç”¨æœåŠ¡è®¿é—®ï¼Œä¸èƒ½ç›´æ¥ä»å‰ç«¯è®¿é—®

# åˆ›å»ºä¸‰ä¸ªnamespace
ip netns add frontend
ip netns add backend  
ip netns add database

# é…ç½®ç½‘ç»œè¿æ¥ï¼ˆä½¿ç”¨å‰é¢çš„ç½‘æ¡¥æ–¹æ¡ˆï¼‰
# ... ç½‘æ¡¥å’Œvethé…ç½®ä»£ç  ...

# åœ¨database namespaceè®¾ç½®ä¸¥æ ¼çš„é˜²ç«å¢™è§„åˆ™
ip netns exec database iptables -A INPUT -s 192.168.1.20 -j ACCEPT  # åªå…è®¸backendè®¿é—®
ip netns exec database iptables -A INPUT -s 192.168.1.10 -j DROP    # æ‹’ç»frontendç›´æ¥è®¿é—®
ip netns exec database iptables -P INPUT DROP  # é»˜è®¤æ‹’ç»

# æµ‹è¯•å®‰å…¨ç­–ç•¥
ip netns exec frontend ping 192.168.1.30   # åº”è¯¥å¤±è´¥
ip netns exec backend ping 192.168.1.30    # åº”è¯¥æˆåŠŸ
```

---

## 7. ğŸŒ‰ ç½‘æ¡¥è¿æ¥æŠ€æœ¯


### 7.1 Linuxç½‘æ¡¥åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯Linuxç½‘æ¡¥**
Linuxç½‘æ¡¥ï¼ˆbridgeï¼‰å°±åƒç°å®ä¸­çš„**ç½‘ç»œäº¤æ¢æœº**ï¼š
- å¯ä»¥è¿æ¥å¤šä¸ªç½‘ç»œæ¥å£
- è‡ªåŠ¨å­¦ä¹ MACåœ°å€
- æ ¹æ®MACåœ°å€è½¬å‘æ•°æ®å¸§
- æ”¯æŒç”Ÿæˆæ ‘åè®®é˜²æ­¢ç¯è·¯

**ğŸ’¡ ç½‘æ¡¥çš„å·¥ä½œåŸç†**
```
ç½‘æ¡¥å·¥ä½œç¤ºæ„å›¾ï¼š

   veth1     veth2     veth3
     â”‚        â”‚         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
           Linux Bridge
           (br0ç½‘æ¡¥)
              â”‚
         ç‰©ç†ç½‘å¡(eth0)
```

### 7.2 åˆ›å»ºå’Œé…ç½®ç½‘æ¡¥


**âš¡ ç½‘æ¡¥åˆ›å»ºæ­¥éª¤**
```bash
# ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç½‘æ¡¥
ip link add br0 type bridge

# ç¬¬äºŒæ­¥ï¼šå¯ç”¨ç½‘æ¡¥
ip link set br0 up

# ç¬¬ä¸‰æ­¥ï¼šä¸ºç½‘æ¡¥åˆ†é…IPåœ°å€ï¼ˆå¯é€‰ï¼‰
ip addr add 192.168.1.1/24 dev br0

# ç¬¬å››æ­¥ï¼šå°†æ¥å£è¿æ¥åˆ°ç½‘æ¡¥
ip link set veth0 master br0
ip link set veth1 master br0

# æŸ¥çœ‹ç½‘æ¡¥ä¿¡æ¯
bridge link show
bridge fdb show  # æŸ¥çœ‹MACåœ°å€è½¬å‘è¡¨
```

### 7.3 ç½‘æ¡¥é«˜çº§é…ç½®


**ğŸ”§ ç½‘æ¡¥å‚æ•°è°ƒä¼˜**

| **å‚æ•°** | **ä½œç”¨** | **é…ç½®å‘½ä»¤** |
|---------|---------|-------------|
| **è½¬å‘å»¶è¿Ÿ** | `é˜²æ­¢è½¬å‘ç¯è·¯` | `ip link set br0 type bridge forward_delay 2` |
| **Helloæ—¶é—´** | `STPåè®®å¿ƒè·³` | `ip link set br0 type bridge hello_time 1` |
| **æœ€å¤§ç”Ÿå­˜æ—¶é—´** | `MACåœ°å€è€åŒ–` | `ip link set br0 type bridge max_age 6` |
| **STPåè®®** | `ç”Ÿæˆæ ‘åè®®å¼€å…³` | `ip link set br0 type bridge stp_state 1` |

### 7.4 ç½‘æ¡¥åœ¨å®¹å™¨ç½‘ç»œä¸­çš„åº”ç”¨


**ğŸ³ Dockerç½‘æ¡¥æ¨¡å¼è§£æ**

Dockeré»˜è®¤åˆ›å»ºåä¸ºdocker0çš„ç½‘æ¡¥ï¼š
```bash
# æŸ¥çœ‹dockerç½‘æ¡¥
ip link show docker0

# æŸ¥çœ‹è¿æ¥åˆ°docker0çš„å®¹å™¨æ¥å£
docker run -d nginx
bridge link show
```

å®¹å™¨ç½‘ç»œè¿æ¥è¿‡ç¨‹ï¼š
1. **åˆ›å»ºå®¹å™¨**æ—¶è‡ªåŠ¨åˆ›å»ºveth pair
2. **ä¸€ç«¯**æ”¾å…¥å®¹å™¨çš„ç½‘ç»œnamespace
3. **å¦ä¸€ç«¯**è¿æ¥åˆ°docker0ç½‘æ¡¥
4. **å®¹å™¨**é€šè¿‡ç½‘æ¡¥ä¸å…¶ä»–å®¹å™¨é€šä¿¡

---

## 8. ğŸŒ IPåœ°å€åˆ†é…ç®¡ç†


### 8.1 IPåœ°å€åˆ†é…ç­–ç•¥


**ğŸ“Š å¸¸ç”¨IPåˆ†é…æ–¹æ¡ˆ**

| **åˆ†é…æ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|-------------|-------------|---------|---------|
| **é™æ€åˆ†é…** | `å›ºå®šæœåŠ¡åœ°å€` | `åœ°å€ç¨³å®šï¼Œæ˜“ç®¡ç†` | `æ‰‹å·¥é…ç½®ç¹ç` |
| **DHCPåˆ†é…** | `åŠ¨æ€ç¯å¢ƒ` | `è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜` | `éœ€è¦DHCPæœåŠ¡` |
| **è‡ªåŠ¨åˆ†é…** | `å®¹å™¨ç¯å¢ƒ` | `å®Œå…¨è‡ªåŠ¨åŒ–` | `åœ°å€å¯èƒ½å†²çª` |

### 8.2 ç½‘ç»œåœ°å€è§„åˆ’


**ğŸ—ºï¸ åˆç†çš„åœ°å€è§„åˆ’æ–¹æ¡ˆ**

```
ç½‘ç»œåœ°å€åˆ†æ®µè§„åˆ’ï¼š

ç®¡ç†ç½‘ç»œï¼š    10.0.0.0/24     (10.0.0.1-10.0.0.254)
å‰ç«¯æœåŠ¡ï¼š    10.0.1.0/24     (10.0.1.1-10.0.1.254)  
åç«¯æœåŠ¡ï¼š    10.0.2.0/24     (10.0.2.1-10.0.2.254)
æ•°æ®åº“ï¼š      10.0.3.0/24     (10.0.3.1-10.0.3.254)
å­˜å‚¨ç½‘ç»œï¼š    10.0.4.0/24     (10.0.4.1-10.0.4.254)
```

### 8.3 IPåœ°å€é…ç½®å®è·µ


**âš¡ åœ°å€é…ç½®å‘½ä»¤é›†åˆ**
```bash
# æ·»åŠ IPåœ°å€
ip netns exec ns1 ip addr add 10.0.1.100/24 dev veth0

# æ·»åŠ å¤šä¸ªIPåœ°å€
ip netns exec ns1 ip addr add 10.0.1.101/24 dev veth0
ip netns exec ns1 ip addr add 10.0.2.100/24 dev veth0

# æŸ¥çœ‹IPåœ°å€é…ç½®
ip netns exec ns1 ip addr show

# åˆ é™¤IPåœ°å€
ip netns exec ns1 ip addr del 10.0.1.101/24 dev veth0

# ä¿®æ”¹IPåœ°å€ï¼ˆå…ˆåˆ é™¤å†æ·»åŠ ï¼‰
ip netns exec ns1 ip addr del 10.0.1.100/24 dev veth0
ip netns exec ns1 ip addr add 10.0.1.200/24 dev veth0
```

### 8.4 åœ°å€å†²çªæ£€æµ‹ä¸è§£å†³


**ğŸ” åœ°å€å†²çªè¯Šæ–­**
```bash
# æ£€æŸ¥åœ°å€æ˜¯å¦è¢«ä½¿ç”¨
ip netns exec ns1 ping -c 1 10.0.1.100

# æŸ¥çœ‹ARPè¡¨ä¸­çš„åœ°å€æ˜ å°„
ip netns exec ns1 ip neigh show

# ä½¿ç”¨arpingæ£€æµ‹åœ°å€å†²çª
ip netns exec ns1 arping -c 3 -I veth0 10.0.1.100
```

**ğŸ’¡ å†²çªè§£å†³æ–¹æ¡ˆ**
- **é¢„åˆ†é…**ï¼šæå‰è§„åˆ’å¥½å„namespaceçš„åœ°å€æ®µ
- **åŠ¨æ€æ£€æµ‹**ï¼šé…ç½®å‰å…ˆpingæµ‹è¯•
- **æ–‡æ¡£è®°å½•**ï¼šç»´æŠ¤IPåœ°å€åˆ†é…è¡¨
- **è‡ªåŠ¨åŒ–å·¥å…·**ï¼šä½¿ç”¨è„šæœ¬è‡ªåŠ¨åˆ†é…å’Œæ£€æµ‹

---

## 9. ğŸ”§ æ•…éšœæ’æŸ¥ä¸è°ƒè¯•


### 9.1 å¸¸è§ç½‘ç»œé—®é¢˜åˆ†ç±»


**ğŸ“‹ æ•…éšœç±»å‹ä¸åŸå› **

| **æ•…éšœç°è±¡** | **å¯èƒ½åŸå› ** | **æ’æŸ¥é‡ç‚¹** |
|-------------|-------------|-------------|
| **æ— æ³•pingé€š** | `æ¥å£æœªå¯ç”¨ã€IPé…ç½®é”™è¯¯` | `æ£€æŸ¥æ¥å£çŠ¶æ€å’Œåœ°å€` |
| **è·¯ç”±ä¸é€š** | `è·¯ç”±è¡¨ç¼ºå°‘æ¡ç›®` | `æŸ¥çœ‹è·¯ç”±é…ç½®` |
| **DNSè§£æå¤±è´¥** | `DNSé…ç½®é”™è¯¯` | `æ£€æŸ¥/etc/resolv.conf` |
| **æœåŠ¡æ— æ³•è®¿é—®** | `é˜²ç«å¢™é˜»æ­¢ã€ç«¯å£æœªç›‘å¬` | `æ£€æŸ¥iptableså’ŒæœåŠ¡çŠ¶æ€` |

### 9.2 æ•…éšœæ’æŸ¥å·¥å…·ç®±


**ğŸ› ï¸ å¿…å¤‡è°ƒè¯•å‘½ä»¤**

```bash
# ç½‘ç»œæ¥å£è¯Šæ–­
ip netns exec ns1 ip link show        # æŸ¥çœ‹æ¥å£çŠ¶æ€
ip netns exec ns1 ip addr show        # æŸ¥çœ‹IPé…ç½®
ip netns exec ns1 ip route show       # æŸ¥çœ‹è·¯ç”±è¡¨

# è¿é€šæ€§æµ‹è¯•
ip netns exec ns1 ping ç›®æ ‡IP         # åŸºç¡€è¿é€šæµ‹è¯•
ip netns exec ns1 traceroute ç›®æ ‡IP   # è·¯ç”±è·¯å¾„è·Ÿè¸ª
ip netns exec ns1 mtr ç›®æ ‡IP          # å®æ—¶ç½‘ç»œè¯Šæ–­

# ç«¯å£å’ŒæœåŠ¡æµ‹è¯•
ip netns exec ns1 ss -tuln           # æŸ¥çœ‹ç›‘å¬ç«¯å£
ip netns exec ns1 netstat -i         # æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡
ip netns exec ns1 telnet IP ç«¯å£     # æµ‹è¯•ç«¯å£è¿é€šæ€§

# æŠ“åŒ…åˆ†æ
ip netns exec ns1 tcpdump -i veth0   # æŠ“å–ç½‘ç»œåŒ…
```

### 9.3 å…¸å‹æ•…éšœæ¡ˆä¾‹ä¸è§£å†³


**ğŸ¯ æ¡ˆä¾‹ä¸€ï¼šveth pairæ— æ³•é€šä¿¡**

**æ•…éšœç°è±¡**ï¼šåˆ›å»ºäº†veth pairä½†pingä¸é€š
```bash
# æ•…éšœæ’æŸ¥æ­¥éª¤
ip netns exec ns1 ip link show        # æ£€æŸ¥æ¥å£æ˜¯å¦UP
ip netns exec ns1 ip addr show        # æ£€æŸ¥IPé…ç½®
ip netns exec ns1 ip route show       # æ£€æŸ¥è·¯ç”±

# å¸¸è§é—®é¢˜ä¸è§£å†³
# 1. æ¥å£æœªå¯ç”¨
ip netns exec ns1 ip link set veth0 up

# 2. IPåœ°å€é…ç½®é”™è¯¯
ip netns exec ns1 ip addr add 10.0.1.1/24 dev veth0

# 3. è·¯ç”±ç¼ºå¤±
ip netns exec ns1 ip route add 10.0.2.0/24 dev veth0
```

**ğŸ¯ æ¡ˆä¾‹äºŒï¼šç½‘æ¡¥è¿æ¥é—®é¢˜**

**æ•…éšœç°è±¡**ï¼šå¤šä¸ªnamespaceé€šè¿‡ç½‘æ¡¥æ— æ³•äº’é€š
```bash
# æ£€æŸ¥ç½‘æ¡¥çŠ¶æ€
bridge link show                     # æŸ¥çœ‹æ¡¥æ¥å£
bridge fdb show                      # æŸ¥çœ‹MACè½¬å‘è¡¨

# å¸¸è§è§£å†³æ–¹æ¡ˆ
# 1. ç½‘æ¡¥æœªå¯ç”¨
ip link set br0 up

# 2. æ¥å£æœªæ­£ç¡®æ¡¥æ¥
ip link set veth0 master br0

# 3. é˜²ç«å¢™é˜»æ­¢æ¡¥æ¥é€šä¿¡
iptables -A FORWARD -i br0 -j ACCEPT
```

### 9.4 æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–


**ğŸ“Š ç½‘ç»œæ€§èƒ½æŒ‡æ ‡**

```bash
# æŸ¥çœ‹ç½‘ç»œæµé‡ç»Ÿè®¡
ip netns exec ns1 cat /proc/net/dev

# ç›‘æ§ç½‘ç»œè¿æ¥çŠ¶æ€
ip netns exec ns1 ss -s

# æµ‹è¯•ç½‘ç»œå¸¦å®½
# åœ¨ä¸€ä¸ªnamespaceä¸­å¯åŠ¨æœåŠ¡ç«¯
ip netns exec ns1 iperf3 -s

# åœ¨å¦ä¸€ä¸ªnamespaceä¸­æµ‹è¯•
ip netns exec ns2 iperf3 -c 10.0.1.1
```

**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
- **å‡å°‘ç½‘ç»œå±‚æ¬¡**ï¼šé¿å…è¿‡å¤šçš„è™šæ‹Ÿå±‚
- **åˆç†é…ç½®MTU**ï¼šæ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´åŒ…å¤§å°
- **å¯ç”¨ç½‘å¡ç‰¹æ€§**ï¼šå¦‚TSOã€GSOç­‰ç¡¬ä»¶åŠ é€Ÿ
- **ä¼˜åŒ–è·¯ç”±è¡¨**ï¼šå‡å°‘ä¸å¿…è¦çš„è·¯ç”±æ¡ç›®

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Network Namespaceï¼šLinuxå†…æ ¸æä¾›çš„ç½‘ç»œèµ„æºå®Œå…¨éš”ç¦»æŠ€æœ¯
ğŸ”¸ éš”ç¦»èŒƒå›´ï¼šç½‘ç»œæ¥å£ã€è·¯ç”±è¡¨ã€é˜²ç«å¢™è§„åˆ™ã€ç«¯å£ç©ºé—´ç­‰å…¨éƒ¨éš”ç¦»
ğŸ”¸ veth pairï¼šè™šæ‹Ÿç½‘å¡å¯¹ï¼Œæ˜¯namespaceé—´é€šä¿¡çš„åŸºç¡€è¿æ¥æ–¹å¼
ğŸ”¸ ç½‘æ¡¥æŠ€æœ¯ï¼šç±»ä¼¼äº¤æ¢æœºï¼Œå¯è¿æ¥å¤šä¸ªç½‘ç»œæ¥å£å®ç°é€šä¿¡
ğŸ”¸ IPåœ°å€ç®¡ç†ï¼šæ¯ä¸ªnamespaceç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œéœ€è¦åˆç†è§„åˆ’
ğŸ”¸ æ•…éšœæ’æŸ¥ï¼šæŒæ¡åŸºæœ¬çš„ç½‘ç»œè¯Šæ–­å‘½ä»¤å’Œæ’æŸ¥æ€è·¯
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Network Namespaceçš„æœ¬è´¨**
```
ç†è§£è¦ç‚¹ï¼š
â€¢ å®Œå…¨ç‹¬ç«‹çš„ç½‘ç»œç¯å¢ƒ â†’ å°±åƒç‹¬ç«‹çš„å°æˆ¿é—´
â€¢ é»˜è®¤å®Œå…¨éš”ç¦» â†’ éœ€è¦ä¸»åŠ¨å»ºç«‹è¿æ¥é€šé“  
â€¢ èµ„æºå®Œå…¨ç‹¬ç«‹ â†’ è·¯ç”±ã€é˜²ç«å¢™ã€ç«¯å£éƒ½ç‹¬ç«‹
â€¢ å®¹å™¨æŠ€æœ¯åŸºç¡€ â†’ Dockerç­‰å®¹å™¨æŠ€æœ¯çš„ç½‘ç»œåŸºçŸ³
```

**ğŸ”¹ veth pairå·¥ä½œæœºåˆ¶**
```
æ ¸å¿ƒåŸç†ï¼š
â€¢ æˆå¯¹å‡ºç° â†’ ä¸€æ ¹ç½‘çº¿çš„ä¸¤ç«¯
â€¢ æ•°æ®ç›´é€š â†’ ä¸€ç«¯å‘é€å¦ä¸€ç«¯ç›´æ¥æ¥æ”¶
â€¢ è·¨namespace â†’ å¯åˆ†å¸ƒåœ¨ä¸åŒç½‘ç»œç©ºé—´
â€¢ åŒå‘é€šä¿¡ â†’ ä¸¤ç«¯éƒ½å¯å‘é€å’Œæ¥æ”¶æ•°æ®
```

**ğŸ”¹ ç½‘ç»œé€šä¿¡çš„å±‚æ¬¡ç»“æ„**
```
é€šä¿¡å±‚æ¬¡ï¼š
åº”ç”¨å±‚ â†’ namespaceå†…çš„è¿›ç¨‹é€šä¿¡
ç½‘ç»œå±‚ â†’ veth/bridgeè¿æ¥ä¸åŒnamespace  
ç‰©ç†å±‚ â†’ æœ€ç»ˆé€šè¿‡ç‰©ç†ç½‘å¡å¯¹å¤–é€šä¿¡
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¼ä¸šçº§åº”ç”¨åœºæ™¯**
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šDockerã€Kubernetesç­‰å®¹å™¨ç¼–æ’å¹³å°
- **äº‘è®¡ç®—å¹³å°**ï¼šå¤šç§Ÿæˆ·ç½‘ç»œéš”ç¦»ï¼Œå®‰å…¨æ€§ä¿éšœ
- **å¼€å‘æµ‹è¯•ç¯å¢ƒ**ï¼šæ¨¡æ‹Ÿå¤æ‚ç½‘ç»œæ‹“æ‰‘ï¼Œé™ä½ç¡¬ä»¶æˆæœ¬
- **ç½‘ç»œå®‰å…¨**ï¼šå¾®åˆ†æ®µæŠ€æœ¯ï¼Œç²¾ç»†åŒ–ç½‘ç»œè®¿é—®æ§åˆ¶

**ğŸ¯ å­¦ä¹ è¿›é˜¶è·¯å¾„**
- **å®¹å™¨ç½‘ç»œ**ï¼šæ·±å…¥å­¦ä¹ Dockerã€Kubernetesç½‘ç»œæ¨¡å‹
- **SDNæŠ€æœ¯**ï¼šè½¯ä»¶å®šä¹‰ç½‘ç»œï¼Œç½‘ç»œè™šæ‹ŸåŒ–é«˜çº§æŠ€æœ¯
- **ç½‘ç»œå®‰å…¨**ï¼šåŸºäºnamespaceçš„å®‰å…¨éš”ç¦»ç­–ç•¥
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé«˜æ€§èƒ½ç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯

### 10.4 å®è·µæ“ä½œè¦ç‚¹


**âœ… æ“ä½œæœ€ä½³å®è·µ**
```
åˆ›å»ºæµç¨‹æ ‡å‡†åŒ–ï¼š
1. åˆ›å»ºnamespace â†’ ip netns add
2. åˆ›å»ºveth pair â†’ ip link add type veth peer
3. åˆ†é…æ¥å£ â†’ ip link set netns 
4. é…ç½®åœ°å€ â†’ ip addr add
5. å¯ç”¨æ¥å£ â†’ ip link set up
6. æµ‹è¯•è¿é€š â†’ pingæµ‹è¯•
```

**âš ï¸ å¸¸è§é”™è¯¯é¿å…**
```
â€¢ å¿˜è®°å¯ç”¨æ¥å£ â†’ å¿…é¡»è®¾ç½®ä¸ºupçŠ¶æ€
â€¢ IPåœ°å€é…ç½®é”™è¯¯ â†’ æ³¨æ„ç½‘æ®µè§„åˆ’
â€¢ è·¯ç”±è¡¨ç¼ºå¤± â†’ è·¨ç½‘æ®µéœ€è¦è·¯ç”±
â€¢ é˜²ç«å¢™é˜»æ­¢ â†’ æ£€æŸ¥iptablesè§„åˆ™
â€¢ æ¥å£æœªæ¡¥æ¥ â†’ bridgeè¿æ¥éœ€è¦masterè®¾ç½®
```

**ğŸ”§ è°ƒè¯•æŠ€èƒ½æ¸…å•**
```
â€¢ ä½¿ç”¨ipå‘½ä»¤æŸ¥çœ‹ç½‘ç»œé…ç½®çŠ¶æ€
â€¢ ç”¨ping/tracerouteæµ‹è¯•è¿é€šæ€§
â€¢ é€šè¿‡tcpdumpæŠ“åŒ…åˆ†æç½‘ç»œæµé‡
â€¢ æ£€æŸ¥iptablesè§„åˆ™æ’é™¤é˜²ç«å¢™é—®é¢˜
â€¢ ç›‘æ§ç½‘ç»œæ€§èƒ½æŒ‡æ ‡ä¼˜åŒ–é…ç½®
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç½‘ç»œç©ºé—´å„è‡ªç‹¬ï¼Œvethæˆå¯¹æ¥è¿é€š
ç½‘æ¡¥çŠ¹å¦‚äº¤æ¢æœºï¼Œå¤šä¸ªæ¥å£èšä¸€å¤„
è·¯ç”±é˜²ç«å¢™éš”ç¦»ï¼Œå„æœ‰å„çš„è§„åˆ™åº“
åœ°å€è§„åˆ’è¦åˆç†ï¼Œæ•…éšœæ’æŸ¥æœ‰å¥—è·¯
å®¹å™¨æŠ€æœ¯åŸºç¡€çŸ³ï¼Œäº‘è®¡ç®—å®‰å…¨æŠ¤èˆªç¥
```