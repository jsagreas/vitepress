---
title: 11ã€å®¹å™¨è¿è¡Œæ—¶namespaceå®è·µ
---
## ğŸ“š ç›®å½•

1. [Dockerä¸­namespaceçš„ä½¿ç”¨](#1-Dockerä¸­namespaceçš„ä½¿ç”¨)
2. [å®¹å™¨å¯åŠ¨æ—¶namespaceåˆ›å»ºè¿‡ç¨‹](#2-å®¹å™¨å¯åŠ¨æ—¶namespaceåˆ›å»ºè¿‡ç¨‹)
3. [namespaceå‚æ•°è¯¦è§£ä¸å®è·µ](#3-namespaceå‚æ•°è¯¦è§£ä¸å®è·µ)
4. [å…±äº«namespaceçš„å®¹å™¨é€šä¿¡](#4-å…±äº«namespaceçš„å®¹å™¨é€šä¿¡)
5. [privilegedå®¹å™¨çš„namespaceå½±å“](#5-privilegedå®¹å™¨çš„namespaceå½±å“)
6. [å®¹å™¨escapeä¸namespaceçªç ´](#6-å®¹å™¨escapeä¸namespaceçªç ´)
7. [Kubernetesä¸­çš„namespaceåº”ç”¨](#7-Kubernetesä¸­çš„namespaceåº”ç”¨)
8. [å®‰å…¨å®¹å™¨æŠ€æœ¯ä¸­çš„namespaceå¢å¼º](#8-å®‰å…¨å®¹å™¨æŠ€æœ¯ä¸­çš„namespaceå¢å¼º)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ³ Dockerä¸­namespaceçš„ä½¿ç”¨


### 1.1 ä»€ä¹ˆæ˜¯å®¹å™¨ä¸­çš„namespace


**é€šä¿—ç†è§£**ï¼šå¦‚æœæŠŠLinuxç³»ç»Ÿæ¯”ä½œä¸€æ ‹å¤§æ¥¼ï¼Œé‚£ä¹ˆnamespaceå°±åƒæ˜¯åœ¨è¿™æ ‹æ¥¼é‡Œåˆ’åˆ†å‡ºä¸åŒçš„æˆ¿é—´ï¼Œæ¯ä¸ªå®¹å™¨ä½åœ¨è‡ªå·±çš„æˆ¿é—´é‡Œï¼Œçœ‹ä¸åˆ°å…¶ä»–æˆ¿é—´çš„ä¸œè¥¿ã€‚

```
ä¼ ç»ŸLinuxç³»ç»Ÿï¼š
æ‰€æœ‰è¿›ç¨‹å…±äº«åŒä¸€ä¸ª"è§†é‡"
è¿›ç¨‹A â†â†’ è¿›ç¨‹B â†â†’ è¿›ç¨‹C
    â†‘       â†‘       â†‘
   éƒ½èƒ½çœ‹åˆ°ç³»ç»Ÿå…¨è²Œ

å®¹å™¨åŒ–ç³»ç»Ÿï¼š
æ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹"è§†é‡"
[å®¹å™¨A] [å®¹å™¨B] [å®¹å™¨C]
   â†‘       â†‘       â†‘
å„è‡ªçœ‹åˆ°ä¸åŒå†…å®¹
```

### 1.2 Dockerä½¿ç”¨çš„namespaceç±»å‹


**Dockerä¸»è¦ä½¿ç”¨6ç§namespace**ï¼š

| namespaceç±»å‹ | **ä½œç”¨è¯´æ˜** | **éš”ç¦»å†…å®¹** | **å®é™…æ•ˆæœ** |
|--------------|-------------|------------|-------------|
| ğŸ”’ **PID** | `è¿›ç¨‹éš”ç¦»` | `è¿›ç¨‹IDç©ºé—´` | `å®¹å™¨å†…è¿›ç¨‹IDä»1å¼€å§‹ï¼Œçœ‹ä¸åˆ°å®¿ä¸»æœºå…¶ä»–è¿›ç¨‹` |
| ğŸŒ **Network** | `ç½‘ç»œéš”ç¦»` | `ç½‘ç»œæ ˆ` | `ç‹¬ç«‹çš„IPåœ°å€ã€ç«¯å£ã€è·¯ç”±è¡¨` |
| ğŸ“ **Mount** | `æ–‡ä»¶ç³»ç»Ÿéš”ç¦»` | `æŒ‚è½½ç‚¹` | `ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾` |
| ğŸ’¬ **IPC** | `è¿›ç¨‹é€šä¿¡éš”ç¦»` | `æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡` | `å®¹å™¨é—´æ— æ³•ç›´æ¥é€šä¿¡` |
| ğŸ†” **UTS** | `ä¸»æœºåéš”ç¦»` | `ä¸»æœºåã€åŸŸå` | `æ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹hostname` |
| ğŸ‘¤ **User** | `ç”¨æˆ·éš”ç¦»` | `ç”¨æˆ·IDæ˜ å°„` | `å®¹å™¨å†…rootä¸ç­‰äºå®¿ä¸»æœºroot` |

### 1.3 Dockerå¦‚ä½•åˆ›å»ºnamespace


**å®¹å™¨å¯åŠ¨è¿‡ç¨‹ä¸­çš„namespaceåˆ›å»º**ï¼š

```
Dockerå¯åŠ¨å®¹å™¨çš„å¹•åè¿‡ç¨‹ï¼š

æ­¥éª¤1ï¸âƒ£ Docker daemonæ¥æ”¶runå‘½ä»¤
     â†“
æ­¥éª¤2ï¸âƒ£ è°ƒç”¨containerdåˆ›å»ºå®¹å™¨è§„èŒƒ
     â†“  
æ­¥éª¤3ï¸âƒ£ runcæ ¹æ®è§„èŒƒåˆ›å»ºå„ç§namespace
     â†“
æ­¥éª¤4ï¸âƒ£ åœ¨æ–°namespaceä¸­å¯åŠ¨å®¹å™¨è¿›ç¨‹
     â†“
æ­¥éª¤5ï¸âƒ£ å®¹å™¨è¿›ç¨‹åªèƒ½çœ‹åˆ°è‡ªå·±çš„namespaceå†…å®¹
```

**å®é™…éªŒè¯namespaceéš”ç¦»**ï¼š
```bash
# æŸ¥çœ‹å®¿ä¸»æœºè¿›ç¨‹
ps aux | wc -l
# è¾“å‡ºï¼š200å¤šä¸ªè¿›ç¨‹

# å¯åŠ¨å®¹å™¨å¹¶æŸ¥çœ‹è¿›ç¨‹
docker run -it ubuntu bash
ps aux
# è¾“å‡ºï¼šåªæœ‰å‡ ä¸ªè¿›ç¨‹ï¼ŒPIDä»1å¼€å§‹
```

---

## 2. âš™ï¸ å®¹å™¨å¯åŠ¨æ—¶namespaceåˆ›å»ºè¿‡ç¨‹


### 2.1 namespaceåˆ›å»ºçš„è¯¦ç»†æµç¨‹


**æ·±å…¥ç†è§£å®¹å™¨å¯åŠ¨è¿‡ç¨‹**ï¼š

```
å®¿ä¸»æœºçŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å®¿ä¸»æœºLinuxç³»ç»Ÿ           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚è¿›ç¨‹Aâ”‚ â”‚è¿›ç¨‹Bâ”‚ â”‚è¿›ç¨‹Câ”‚  ...   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜       â”‚
â”‚        å…±äº«åŒä¸€ä¸ªnamespace        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¯åŠ¨å®¹å™¨åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å®¿ä¸»æœºLinuxç³»ç»Ÿ           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚è¿›ç¨‹Aâ”‚ â”‚è¿›ç¨‹Bâ”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      å®¹å™¨namespace       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚è¿›ç¨‹1â”‚ â”‚è¿›ç¨‹2â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åˆ›å»ºè¿‡ç¨‹çš„æŠ€æœ¯ç»†èŠ‚


**namespaceåˆ›å»ºçš„ç³»ç»Ÿè°ƒç”¨åºåˆ—**ï¼š

```
1. clone()ç³»ç»Ÿè°ƒç”¨åˆ›å»ºæ–°è¿›ç¨‹
   â”œâ”€ CLONE_NEWPID: åˆ›å»ºæ–°çš„PID namespace
   â”œâ”€ CLONE_NEWNET: åˆ›å»ºæ–°çš„ç½‘ç»œnamespace  
   â”œâ”€ CLONE_NEWNS: åˆ›å»ºæ–°çš„æŒ‚è½½namespace
   â”œâ”€ CLONE_NEWIPC: åˆ›å»ºæ–°çš„IPC namespace
   â”œâ”€ CLONE_NEWUTS: åˆ›å»ºæ–°çš„UTS namespace
   â””â”€ CLONE_NEWUSER: åˆ›å»ºæ–°çš„ç”¨æˆ·namespace

2. è®¾ç½®namespaceå±æ€§
   â”œâ”€ é…ç½®ç½‘ç»œæ¥å£
   â”œâ”€ æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ
   â”œâ”€ è®¾ç½®ä¸»æœºå
   â””â”€ é…ç½®ç”¨æˆ·æ˜ å°„

3. exec()æ‰§è¡Œå®¹å™¨ç¨‹åº
   â””â”€ å®¹å™¨è¿›ç¨‹åœ¨æ–°namespaceä¸­å¼€å§‹è¿è¡Œ
```

### 2.3 éªŒè¯namespaceåˆ›å»º


**æŸ¥çœ‹å®¹å™¨çš„namespaceä¿¡æ¯**ï¼š

```bash
# å¯åŠ¨ä¸€ä¸ªå®¹å™¨
docker run -d --name test nginx

# æŸ¥çœ‹å®¹å™¨è¿›ç¨‹çš„namespace
docker inspect test --format '{{.State.Pid}}'
# è¾“å‡ºè¿›ç¨‹IDï¼Œæ¯”å¦‚ï¼š12345

# æŸ¥çœ‹è¯¥è¿›ç¨‹çš„namespace
ls -la /proc/12345/ns/
```

**è¾“å‡ºè§£è¯»**ï¼š
```
lrwxrwxrwx 1 root root 0 Sep 17 15:30 ipc -> ipc:[4026532456]
lrwxrwxrwx 1 root root 0 Sep 17 15:30 mnt -> mnt:[4026532454] 
lrwxrwxrwx 1 root root 0 Sep 17 15:30 net -> net:[4026532459]
lrwxrwxrwx 1 root root 0 Sep 17 15:30 pid -> pid:[4026532457]
lrwxrwxrwx 1 root root 0 Sep 17 15:30 uts -> uts:[4026532455]
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼šæ¯ä¸ªnamespaceéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDå·ï¼Œç›¸åŒIDè¡¨ç¤ºå…±äº«åŒä¸€ä¸ªnamespaceã€‚

---

## 3. ğŸ”§ namespaceå‚æ•°è¯¦è§£ä¸å®è·µ


### 3.1 --pidå‚æ•°è¯¦è§£


**PID namespaceçš„ä½œç”¨**ï¼šè®©å®¹å™¨æ‹¥æœ‰ç‹¬ç«‹çš„è¿›ç¨‹IDç©ºé—´ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹ä»PID 1å¼€å§‹ç¼–å·ã€‚

**é»˜è®¤è¡Œä¸ºæ¼”ç¤º**ï¼š
```bash
# é»˜è®¤PIDéš”ç¦»
docker run -it ubuntu ps aux
# è¾“å‡ºï¼šPID 1æ˜¯å®¹å™¨çš„ä¸»è¿›ç¨‹
```

**--pidå‚æ•°çš„ä¸åŒé€‰é¡¹**ï¼š

| å‚æ•°å€¼ | **å«ä¹‰** | **å®é™…æ•ˆæœ** |
|--------|---------|-------------|
| `--pid container:åç§°` | `å…±äº«å…¶ä»–å®¹å™¨çš„PID namespace` | `èƒ½çœ‹åˆ°ç›®æ ‡å®¹å™¨çš„æ‰€æœ‰è¿›ç¨‹` |
| `--pid host` | `å…±äº«å®¿ä¸»æœºPID namespace` | `èƒ½çœ‹åˆ°å®¿ä¸»æœºæ‰€æœ‰è¿›ç¨‹` |
| é»˜è®¤ | `åˆ›å»ºç‹¬ç«‹PID namespace` | `åªèƒ½çœ‹åˆ°å®¹å™¨å†…è¿›ç¨‹` |

**å®è·µç¤ºä¾‹**ï¼š
```bash
# 1. å¯åŠ¨ç¬¬ä¸€ä¸ªå®¹å™¨
docker run -d --name container1 nginx

# 2. å¯åŠ¨ç¬¬äºŒä¸ªå®¹å™¨ï¼Œå…±äº«container1çš„PID namespace
docker run -it --pid container:container1 ubuntu bash
ps aux  # èƒ½çœ‹åˆ°nginxè¿›ç¨‹

# 3. å¯åŠ¨å®¹å™¨å…±äº«å®¿ä¸»æœºPID namespace
docker run -it --pid host ubuntu bash
ps aux  # èƒ½çœ‹åˆ°å®¿ä¸»æœºæ‰€æœ‰è¿›ç¨‹
```

### 3.2 --networkå‚æ•°è¯¦è§£


**ç½‘ç»œnamespaceçš„æ„ä¹‰**ï¼šæ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„ç½‘ç»œæ ˆï¼ŒåŒ…æ‹¬ç½‘å¡ã€IPåœ°å€ã€è·¯ç”±è¡¨ç­‰ã€‚

**ç½‘ç»œæ¨¡å¼å¯¹æ¯”**ï¼š

```
bridgeæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼š
å®¿ä¸»æœº â†â†’ docker0ç½‘æ¡¥ â†â†’ å®¹å™¨veth pair
å®¹å™¨è·å¾—ç‹¬ç«‹IPï¼š172.17.0.x

hostæ¨¡å¼ï¼š
å®¿ä¸»æœºç½‘ç»œæ ˆ â†â†’ å®¹å™¨è¿›ç¨‹
å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºIP

containeræ¨¡å¼ï¼š
å®¹å™¨A â†â†’ å…±äº«ç½‘ç»œnamespace â†â†’ å®¹å™¨B  
ä¸¤ä¸ªå®¹å™¨å…±äº«åŒä¸€ä¸ªIP
```

**å®è·µå¯¹æ¯”**ï¼š
```bash
# bridgeæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
docker run -d nginx
docker exec -it nginx_container ip addr
# çœ‹åˆ°eth0æœ‰172.17.0.xåœ°å€

# hostæ¨¡å¼
docker run -d --network host nginx  
docker exec -it nginx_container ip addr
# çœ‹åˆ°å®¿ä¸»æœºæ‰€æœ‰ç½‘å¡

# containeræ¨¡å¼
docker run -d --name web nginx
docker run -it --network container:web ubuntu bash
ip addr  # å’Œwebå®¹å™¨å®Œå…¨ç›¸åŒçš„ç½‘ç»œé…ç½®
```

### 3.3 --ipcå‚æ•°è¯¦è§£


**IPC namespaceçš„ç”¨é€”**ï¼šéš”ç¦»è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ã€å…±äº«å†…å­˜ç­‰ã€‚

**IPCéš”ç¦»æ¼”ç¤º**ï¼š
```bash
# åœ¨å®¿ä¸»æœºåˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—
ipcs -q  # æŸ¥çœ‹ç°æœ‰é˜Ÿåˆ—

# å¯åŠ¨å®¹å™¨æŸ¥çœ‹IPC
docker run -it ubuntu bash
ipcs -q  # å®¹å™¨å†…çœ‹ä¸åˆ°å®¿ä¸»æœºçš„æ¶ˆæ¯é˜Ÿåˆ—

# å…±äº«å®¿ä¸»æœºIPC
docker run -it --ipc host ubuntu bash  
ipcs -q  # èƒ½çœ‹åˆ°å®¿ä¸»æœºçš„æ¶ˆæ¯é˜Ÿåˆ—
```

---

## 4. ğŸ”— å…±äº«namespaceçš„å®¹å™¨é€šä¿¡


### 4.1 å®¹å™¨é—´å…±äº«namespaceçš„åœºæ™¯


**ä¸ºä»€ä¹ˆéœ€è¦å…±äº«namespace**ï¼Ÿ

```
å®é™…åº”ç”¨åœºæ™¯ï¼š

å¾®æœåŠ¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Webå®¹å™¨   â”‚    â”‚   æ•°æ®åº“å®¹å™¨ â”‚  
â”‚  å…±äº«ç½‘ç»œ    â”‚â†â”€â”€â†’â”‚   å…±äº«ç½‘ç»œ   â”‚
â”‚  localhost   â”‚    â”‚  localhost  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                  â†‘
    å¯ä»¥ç›´æ¥ç”¨localhosté€šä¿¡

ç›‘æ§åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å®¹å™¨   â”‚    â”‚   ç›‘æ§å®¹å™¨   â”‚
â”‚             â”‚    â”‚  å…±äº«PID     â”‚
â”‚   è¿è¡Œä¸šåŠ¡   â”‚    â”‚  ç›‘æ§è¿›ç¨‹    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å…±äº«ç½‘ç»œnamespaceå®è·µ


**åˆ›å»ºå…±äº«ç½‘ç»œçš„å®¹å™¨ç»„**ï¼š

```bash
# åˆ›å»ºç¬¬ä¸€ä¸ªå®¹å™¨ä½œä¸ºç½‘ç»œæä¾›è€…
docker run -d --name web-server nginx

# åˆ›å»ºç¬¬äºŒä¸ªå®¹å™¨å…±äº«ç½‘ç»œ
docker run -it --name client --network container:web-server ubuntu bash

# åœ¨clientå®¹å™¨ä¸­è®¿é—®nginx
curl localhost  # ç›´æ¥è®¿é—®ï¼Œå› ä¸ºå…±äº«ç½‘ç»œæ ˆ
```

**éªŒè¯ç½‘ç»œå…±äº«**ï¼š
```bash
# åœ¨ä¸¤ä¸ªå®¹å™¨ä¸­åˆ†åˆ«æ‰§è¡Œ
ip addr show
netstat -tulpn

# è¾“å‡ºå®Œå…¨ç›¸åŒï¼Œè¯æ˜å…±äº«åŒä¸€ä¸ªç½‘ç»œnamespace
```

### 4.3 Podæ¦‚å¿µçš„å®ç°åŸç†


**Kubernetes Podå°±æ˜¯åŸºäºå…±äº«namespaceå®ç°çš„**ï¼š

```
Podå†…å®¹å™¨å…³ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Pod                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ å®¹å™¨A    â”‚    â”‚ å®¹å™¨B    â”‚    â”‚  
â”‚  â”‚         â”‚    â”‚         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â†‘           â†‘          â”‚
â”‚      å…±äº«ç½‘ç»œnamespace          â”‚
â”‚      å…±äº«å­˜å‚¨volume             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
âœ… å®¹å™¨é—´ç”¨localhosté€šä¿¡
âœ… å…±äº«å­˜å‚¨å·
âœ… ç”Ÿå‘½å‘¨æœŸç»‘å®š
```

**æ¨¡æ‹ŸPodçš„å®ç°**ï¼š
```bash
# 1. åˆ›å»ºpauseå®¹å™¨ï¼ˆæä¾›namespaceï¼‰
docker run -d --name pause busybox sleep 3600

# 2. åˆ›å»ºåº”ç”¨å®¹å™¨å…±äº«namespace
docker run -d --name app1 --network container:pause nginx
docker run -d --name app2 --network container:pause redis

# 3. éªŒè¯é€šä¿¡
docker exec app1 curl localhost:6379  # è®¿é—®Redis
```

---

## 5. ğŸ”“ privilegedå®¹å™¨çš„namespaceå½±å“


### 5.1 ä»€ä¹ˆæ˜¯privilegedå®¹å™¨


**privilegedæ¨¡å¼çš„æœ¬è´¨**ï¼šç»™å®¹å™¨è¿‘ä¹ç­‰åŒäºå®¿ä¸»æœºrootç”¨æˆ·çš„æƒé™ã€‚

```
æ™®é€šå®¹å™¨æƒé™ï¼š
å®¹å™¨ â”€â”€[å—é™æƒé™]â”€â”€â†’ å®¿ä¸»æœºå†…æ ¸
     â†‘
   namespaceéš”ç¦» + capabilitiesé™åˆ¶

privilegedå®¹å™¨æƒé™ï¼š  
å®¹å™¨ â”€â”€[å®Œå…¨æƒé™]â”€â”€â†’ å®¿ä¸»æœºå†…æ ¸
     â†‘
   éƒ¨åˆ†namespaceå¤±æ•ˆ + æ‰€æœ‰capabilities
```

### 5.2 privilegedå¯¹namespaceçš„å½±å“


**namespaceéš”ç¦»çš„å˜åŒ–**ï¼š

| namespace | **æ™®é€šå®¹å™¨** | **privilegedå®¹å™¨** |
|-----------|-------------|-------------------|
| ğŸ”’ **PID** | `éš”ç¦»` | `å¯é€‰æ‹©å…±äº«å®¿ä¸»æœº` |
| ğŸŒ **Network** | `éš”ç¦»` | `é»˜è®¤ä»éš”ç¦»ï¼Œå¯æ‰‹åŠ¨å…±äº«` |
| ğŸ“ **Mount** | `éš”ç¦»` | `èƒ½å¤ŸæŒ‚è½½å®¿ä¸»æœºä»»æ„ä½ç½®` |
| ğŸ†” **User** | `éš”ç¦»` | `å®¹å™¨å†…root=å®¿ä¸»æœºroot` |

**å±é™©æ€§æ¼”ç¤º**ï¼š
```bash
# å¯åŠ¨privilegedå®¹å™¨
docker run -it --privileged ubuntu bash

# å®¹å™¨å†…å¯ä»¥æ‰§è¡Œå±é™©æ“ä½œ
mount /dev/sda1 /mnt        # æŒ‚è½½å®¿ä¸»æœºç¡¬ç›˜
chroot /mnt                 # åˆ‡æ¢åˆ°å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿ
ps aux                      # çœ‹åˆ°å®¿ä¸»æœºè¿›ç¨‹ï¼ˆå¦‚æœå…±äº«PID namespaceï¼‰
```

### 5.3 privilegedçš„åˆç†ä½¿ç”¨åœºæ™¯


**ä»€ä¹ˆæ—¶å€™éœ€è¦privilegedæ¨¡å¼**ï¼Ÿ

```
âœ… åˆç†ä½¿ç”¨åœºæ™¯ï¼š
1. Docker-in-Docker (DinD)
2. ç³»ç»Ÿç›‘æ§å·¥å…·ï¼ˆéœ€è¦è®¿é—®å®¿ä¸»æœºèµ„æºï¼‰
3. ç½‘ç»œç›¸å…³å·¥å…·ï¼ˆéœ€è¦æ“ä½œiptablesï¼‰
4. å­˜å‚¨ç›¸å…³å·¥å…·ï¼ˆéœ€è¦æŒ‚è½½è®¾å¤‡ï¼‰

âŒ ä¸åº”è¯¥ä½¿ç”¨çš„åœºæ™¯ï¼š
1. æ™®é€šWebåº”ç”¨
2. æ•°æ®åº“åº”ç”¨  
3. å¾®æœåŠ¡åº”ç”¨
4. ä»»ä½•ä¸éœ€è¦ç‰¹æ®Šæƒé™çš„åº”ç”¨
```

**å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆ**ï¼š
```bash
# ä»£æ›¿--privilegedï¼Œä½¿ç”¨å…·ä½“çš„capabilities
docker run --cap-add=NET_ADMIN nginx       # åªç»™ç½‘ç»œç®¡ç†æƒé™
docker run --cap-add=SYS_TIME ntpd         # åªç»™æ—¶é—´ç®¡ç†æƒé™
docker run -v /dev:/dev:ro monitoring-tool # åªè¯»æŒ‚è½½è®¾å¤‡
```

---

## 6. âš ï¸ å®¹å™¨escapeä¸namespaceçªç ´


### 6.1 ä»€ä¹ˆæ˜¯å®¹å™¨é€ƒé€¸


**å®¹å™¨é€ƒé€¸çš„å®šä¹‰**ï¼šå®¹å™¨å†…çš„è¿›ç¨‹çªç ´namespaceç­‰éš”ç¦»æœºåˆ¶ï¼Œè·å¾—å®¿ä¸»æœºçš„è®¿é—®æƒé™ã€‚

```
æ­£å¸¸æƒ…å†µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¿ä¸»æœºç³»ç»Ÿ     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   å®¹å™¨namespace â”‚ â”‚
â”‚  â”‚  [åº”ç”¨è¿›ç¨‹]  â”‚ â”‚  â† è¢«éš”ç¦»åœ¨å®¹å™¨å†…
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é€ƒé€¸åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¿ä¸»æœºç³»ç»Ÿ     â”‚ â† åº”ç”¨è¿›ç¨‹çªç ´éš”ç¦»
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   è·å¾—å®¿ä¸»æœºæƒé™
â”‚  â”‚   å®¹å™¨(ç©º)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å¸¸è§çš„namespaceçªç ´æ–¹å¼


**1. é€šè¿‡/procæ–‡ä»¶ç³»ç»Ÿçªç ´**ï¼š

```bash
# åœ¨privilegedå®¹å™¨ä¸­
ls /proc/*/root  # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„rootç›®å½•
# æ‰¾åˆ°PID 1çš„è¿›ç¨‹ï¼ˆé€šå¸¸æ˜¯å®¿ä¸»æœºinitè¿›ç¨‹ï¼‰
chroot /proc/1/root  # åˆ‡æ¢åˆ°å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿ
```

**2. é€šè¿‡è®¾å¤‡æ–‡ä»¶çªç ´**ï¼š
```bash
# å¦‚æœå®¹å™¨æŒ‚è½½äº†å®¿ä¸»æœºè®¾å¤‡
mount /dev/sda1 /mnt
chroot /mnt
# ç°åœ¨åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­
```

**3. é€šè¿‡å…±äº«namespaceçªç ´**ï¼š
```bash
# å¦‚æœå®¹å™¨å…±äº«äº†å®¿ä¸»æœºPID namespace
docker run -it --pid host ubuntu bash
kill -9 1  # å¯ä»¥æ€æ­»å®¿ä¸»æœºinitè¿›ç¨‹ï¼
```

### 6.3 é˜²èŒƒå®¹å™¨é€ƒé€¸çš„æªæ–½


**å®‰å…¨é…ç½®å»ºè®®**ï¼š

| å®‰å…¨æªæ–½ | **é…ç½®æ–¹æ³•** | **é˜²æŠ¤æ•ˆæœ** |
|---------|-------------|-------------|
| ğŸš« **é¿å…privileged** | `ä¸ä½¿ç”¨--privileged` | `é˜²æ­¢æƒé™è¿‡å¤§` |
| ğŸ”’ **é™åˆ¶capabilities** | `--cap-drop=ALL --cap-add=NEEDED` | `æœ€å°æƒé™åŸåˆ™` |
| ğŸ“ **åªè¯»æ–‡ä»¶ç³»ç»Ÿ** | `--read-only` | `é˜²æ­¢ä¿®æ”¹å…³é”®æ–‡ä»¶` |
| ğŸ‘¤ **ç”¨æˆ·æ˜ å°„** | `--user 1000:1000` | `é¿å…å®¹å™¨å†…rootæƒé™` |
| ğŸ›¡ï¸ **å®‰å…¨æ¨¡å—** | `ä½¿ç”¨SELinux/AppArmor` | `å¼ºåˆ¶è®¿é—®æ§åˆ¶` |

**å®é™…å®‰å…¨é…ç½®ç¤ºä¾‹**ï¼š
```bash
# å®‰å…¨çš„å®¹å™¨å¯åŠ¨æ–¹å¼
docker run -d \
  --read-only \                    # åªè¯»æ–‡ä»¶ç³»ç»Ÿ
  --tmpfs /tmp \                   # ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ
  --user 1000:1000 \               # érootç”¨æˆ·
  --cap-drop=ALL \                 # åˆ é™¤æ‰€æœ‰capabilities
  --cap-add=NET_BIND_SERVICE \     # åªæ·»åŠ å¿…éœ€çš„capabilities
  --security-opt=no-new-privileges \ # ç¦æ­¢è·å–æ–°æƒé™
  nginx
```

---

## 7. â˜¸ï¸ Kubernetesä¸­çš„namespaceåº”ç”¨


### 7.1 K8sä¸­çš„åŒé‡namespaceæ¦‚å¿µ


**è¦åŒºåˆ†ä¸¤ç§ä¸åŒçš„namespace**ï¼š

```
1. Linux Namespaceï¼ˆæœ¬æ–‡ä¸»è¦å†…å®¹ï¼‰
   â”œâ”€ æ“ä½œç³»ç»Ÿçº§åˆ«çš„éš”ç¦»
   â”œâ”€ è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰éš”ç¦»
   â””â”€ å®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨

2. Kubernetes Namespace  
   â”œâ”€ K8sé›†ç¾¤çº§åˆ«çš„èµ„æºéš”ç¦»
   â”œâ”€ é€»è¾‘åˆ†ç»„å’Œæƒé™æ§åˆ¶
   â””â”€ ä¸åŒäºLinux namespace
```

### 7.2 Podä¸­çš„namespaceå…±äº«æœºåˆ¶


**Podå†…å®¹å™¨å¦‚ä½•å…±äº«namespace**ï¼š

```
Podåˆ›å»ºè¿‡ç¨‹ï¼š
æ­¥éª¤1ï¸âƒ£ åˆ›å»ºpauseå®¹å™¨ï¼ˆinfrastructure containerï¼‰
     â†“
æ­¥éª¤2ï¸âƒ£ pauseå®¹å™¨åˆ›å»ºç½‘ç»œå’ŒIPC namespace
     â†“  
æ­¥éª¤3ï¸âƒ£ åº”ç”¨å®¹å™¨åŠ å…¥pauseå®¹å™¨çš„namespace
     â†“
æ­¥éª¤4ï¸âƒ£ æ‰€æœ‰å®¹å™¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨

å®é™…ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Pod                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ pause   â”‚ â† æä¾›namespace     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â†‘                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Appå®¹å™¨1 â”‚  â”‚ Appå®¹å™¨2 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â””â”€â”€ å…±äº«ç½‘ç»œnamespace â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 K8sç½‘ç»œç­–ç•¥ä¸namespace


**NetworkPolicyåŸºäºnamespaceçš„ç½‘ç»œéš”ç¦»**ï¼š

```yaml
# ç¤ºä¾‹ï¼šåªå…è®¸åŒnamespaceå†…çš„Podé€šä¿¡
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-cross-namespace
  namespace: production
spec:
  podSelector: {}  # åº”ç”¨åˆ°æ‰€æœ‰Pod
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: production  # åªå…è®¸åŒnamespace
```

**æ•ˆæœå›¾è§£**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Namespace A    â”‚    â”‚  Namespace B    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”        â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Pod1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€âœ—â”€â”€â”€â”€â†’â”‚Pod3 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜        â”‚    â”‚        â””â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”        â”‚    â”‚                 â”‚
â”‚  â”‚Pod2 â”‚â†â”€â”€âœ“â”€â”€â†’ â”‚    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜        â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å†…éƒ¨é€šä¿¡ï¼šå…è®¸         è·¨namespaceï¼šç¦æ­¢
```

---

## 8. ğŸ›¡ï¸ å®‰å…¨å®¹å™¨æŠ€æœ¯ä¸­çš„namespaceå¢å¼º


### 8.1 ä¼ ç»Ÿå®¹å™¨å®‰å…¨é—®é¢˜


**ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨å®¹å™¨æŠ€æœ¯**ï¼Ÿ

```
ä¼ ç»Ÿå®¹å™¨çš„å®‰å…¨éšæ‚£ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å®¿ä¸»æœºå†…æ ¸                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ å®¹å™¨A    â”‚    â”‚ å®¹å™¨B    â”‚    â”‚ â† å…±äº«å†…æ ¸
â”‚  â”‚namespace â”‚    â”‚namespace â”‚    â”‚   å­˜åœ¨é£é™©
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
âŒ å†…æ ¸æ¼æ´å½±å“æ‰€æœ‰å®¹å™¨
âŒ å®¹å™¨é€ƒé€¸é£é™©
âŒ ä¾§ä¿¡é“æ”»å‡»
âŒ èµ„æºç«äº‰
```

### 8.2 å®‰å…¨å®¹å™¨çš„namespaceå¢å¼º


**ä¸»æµå®‰å…¨å®¹å™¨æŠ€æœ¯å¯¹æ¯”**ï¼š

| æŠ€æœ¯ | **namespaceå¢å¼ºæ–¹å¼** | **å®‰å…¨ç­‰çº§** | **æ€§èƒ½å½±å“** |
|------|---------------------|-------------|-------------|
| ğŸ”’ **gVisor** | `ç”¨æˆ·æ€å†…æ ¸æ¨¡æ‹Ÿ` | `é«˜` | `ä¸­ç­‰` |
| ğŸ”§ **Kata Containers** | `ç‹¬ç«‹VM+è½»é‡å†…æ ¸` | `å¾ˆé«˜` | `è¾ƒå¤§` |
| ğŸ›¡ï¸ **Firecracker** | `å¾®VMæŠ€æœ¯` | `å¾ˆé«˜` | `è¾ƒå°` |

### 8.3 gVisorçš„namespaceå®ç°


**gVisorå¦‚ä½•å¢å¼ºnamespaceéš”ç¦»**ï¼š

```
ä¼ ç»Ÿå®¹å™¨ï¼š
åº”ç”¨è¿›ç¨‹ â†’ Linuxå†…æ ¸ â†’ ç¡¬ä»¶

gVisorå®¹å™¨ï¼š
åº”ç”¨è¿›ç¨‹ â†’ Sentry(ç”¨æˆ·æ€å†…æ ¸) â†’ Linuxå†…æ ¸ â†’ ç¡¬ä»¶
              â†‘
         å¢å¼ºçš„namespaceéš”ç¦»
```

**gVisorä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# å®‰è£…gVisor
curl -fsSL https://gvisor.dev/archive.key | sudo gpg --dearmor -o /usr/share/keyrings/gvisor-archive-keyring.gpg
sudo apt-get update && sudo apt-get install -y runsc

# é…ç½®Dockerä½¿ç”¨gVisor
sudo docker run --runtime=runsc -it ubuntu bash

# éªŒè¯éš”ç¦»æ•ˆæœ
dmesg  # åœ¨gVisorå®¹å™¨ä¸­çœ‹ä¸åˆ°çœŸå®å†…æ ¸æ¶ˆæ¯
```

### 8.4 Kata Containersçš„VMçº§éš”ç¦»


**Kata Containersçš„æ¶æ„**ï¼š

```
æ¯ä¸ªPod/å®¹å™¨ç»„è¿è¡Œåœ¨ç‹¬ç«‹VMä¸­ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     VM 1        â”‚    â”‚     VM 2        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Guest OS â”‚  â”‚    â”‚  â”‚  Guest OS â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚å®¹å™¨A  â”‚ â”‚  â”‚    â”‚  â”‚ â”‚å®¹å™¨B  â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                      â†‘
   å®Œå…¨éš”ç¦»çš„VM               å®Œå…¨éš”ç¦»çš„VM
```

**Kata Containersä½¿ç”¨**ï¼š
```bash
# å®‰è£…Kata Containers
sudo apt-get install -y kata-containers

# ä½¿ç”¨Kataè¿è¡Œæ—¶
docker run --runtime=kata-runtime -it ubuntu bash
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ namespaceéš”ç¦»ï¼šå®¹å™¨çš„æ ¸å¿ƒéš”ç¦»æœºåˆ¶ï¼Œæä¾›ç‹¬ç«‹çš„ç³»ç»Ÿè§†å›¾
ğŸ”¸ å…­å¤§namespaceï¼šPIDã€Networkã€Mountã€IPCã€UTSã€Userå„å¸å…¶èŒ
ğŸ”¸ å…±äº«æœºåˆ¶ï¼šå®¹å™¨å¯ä»¥é€‰æ‹©æ€§å…±äº«æŸäº›namespaceå®ç°é€šä¿¡
ğŸ”¸ å®‰å…¨é£é™©ï¼šprivilegedå’Œnamespaceçªç ´æ˜¯ä¸»è¦å®‰å…¨å¨èƒ
ğŸ”¸ K8såº”ç”¨ï¼šPodé€šè¿‡å…±äº«namespaceå®ç°å®¹å™¨ç»„åä½œ
ğŸ”¸ å®‰å…¨å¢å¼ºï¼šå®‰å…¨å®¹å™¨æŠ€æœ¯è¿›ä¸€æ­¥å¼ºåŒ–namespaceéš”ç¦»
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ namespaceä¸æ˜¯ä¸‡èƒ½çš„å®‰å…¨å±éšœ**ï¼š
```
ç†è§£è¦ç‚¹ï¼š
â€¢ namespaceä¸»è¦æä¾›éš”ç¦»ï¼Œä¸æ˜¯å®‰å…¨è¾¹ç•Œ
â€¢ éœ€è¦é…åˆcapabilitiesã€cgroupsç­‰æœºåˆ¶  
â€¢ privilegedæ¨¡å¼ä¼šå¤§å¹…å‰Šå¼±éš”ç¦»æ•ˆæœ
â€¢ å®‰å…¨å®¹å™¨æŠ€æœ¯æ˜¯æ›´å¼ºçš„éš”ç¦»æ–¹æ¡ˆ
```

**ğŸ”¹ å…±äº«namespaceçš„åŒåˆƒå‰‘ç‰¹æ€§**ï¼š
```
ä¼˜åŠ¿ï¼š
âœ… å®¹å™¨é—´é«˜æ•ˆé€šä¿¡ï¼ˆå¦‚Podå†…å®¹å™¨ï¼‰
âœ… ç®€åŒ–ç½‘ç»œé…ç½®å’ŒæœåŠ¡å‘ç°
âœ… å…±äº«å­˜å‚¨å’Œèµ„æº

é£é™©ï¼š
âŒ å‡å°‘éš”ç¦»ç¨‹åº¦
âŒ æ‰©å¤§æ”»å‡»é¢
âŒ æ•…éšœä¼ æ’­
```

**ğŸ”¹ å‚æ•°é€‰æ‹©çš„æƒè¡¡è€ƒè™‘**ï¼š
```
--pid hostï¼š        ä¾¿äºç›‘æ§ vs å®‰å…¨é£é™©
--network containerï¼šé«˜æ•ˆé€šä¿¡ vs éš”ç¦»é™ä½  
--privilegedï¼š      åŠŸèƒ½å®Œæ•´ vs å®‰å…¨æå·®
--ipc hostï¼š        æ€§èƒ½æå‡ vs ä¿¡æ¯æ³„éœ²
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… æ¨èå®è·µ**ï¼š
- é»˜è®¤ä½¿ç”¨å®Œæ•´namespaceéš”ç¦»
- åªåœ¨å¿…è¦æ—¶é€‰æ‹©æ€§å…±äº«ç‰¹å®šnamespace
- é¿å…ä½¿ç”¨privilegedæ¨¡å¼
- åœ¨ç”Ÿäº§ç¯å¢ƒè€ƒè™‘å®‰å…¨å®¹å™¨æŠ€æœ¯
- å®šæœŸå®¡è®¡å®¹å™¨çš„namespaceé…ç½®

**âŒ é¿å…çš„è¯¯åŒº**ï¼š
- ä¸è¦ä¸ºäº†æ–¹ä¾¿è€Œè¿‡åº¦å…±äº«namespace
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒéšæ„ä½¿ç”¨--privileged
- ä¸è¦æ··æ·†Linux namespaceå’ŒK8s namespace
- ä¸è¦å¿½è§†å®¹å™¨é€ƒé€¸çš„å®‰å…¨é£é™©

### 9.4 æ•…éšœæ’æŸ¥è¦ç‚¹


**ğŸ”§ å¸¸è§é—®é¢˜è¯Šæ–­**ï¼š

```
ç½‘ç»œé€šä¿¡é—®é¢˜ï¼š
1. æ£€æŸ¥network namespaceé…ç½®
2. éªŒè¯ç«¯å£ç»‘å®šå’Œé˜²ç«å¢™è§„åˆ™
3. ç¡®è®¤å®¹å™¨é—´ç½‘ç»œç­–ç•¥

è¿›ç¨‹æŸ¥çœ‹é—®é¢˜ï¼š
1. ç¡®è®¤PID namespaceè®¾ç½®
2. æ£€æŸ¥æ˜¯å¦è¯¯ç”¨äº†--pid host
3. éªŒè¯è¿›ç¨‹æƒé™å’Œç”¨æˆ·æ˜ å°„

æ–‡ä»¶è®¿é—®é—®é¢˜ï¼š  
1. æ£€æŸ¥mount namespaceå’ŒæŒ‚è½½ç‚¹
2. ç¡®è®¤ç”¨æˆ·IDæ˜ å°„å…³ç³»
3. éªŒè¯æ–‡ä»¶æƒé™å’ŒSELinuxç­–ç•¥
```

**ğŸ“Š ç›‘æ§æŒ‡æ ‡**ï¼š
- namespaceåˆ›å»ºå’Œé”€æ¯é¢‘ç‡
- å…±äº«namespaceçš„å®¹å™¨æ•°é‡  
- privilegedå®¹å™¨ä½¿ç”¨æƒ…å†µ
- å®¹å™¨é€ƒé€¸å°è¯•æ£€æµ‹

**æ ¸å¿ƒè®°å¿†**ï¼š
- namespaceæ˜¯å®¹å™¨éš”ç¦»çš„åŸºçŸ³ï¼Œå…­å¤§ç±»å‹å„æœ‰ä½œç”¨
- å…±äº«namespaceæé«˜æ•ˆç‡ä½†é™ä½éš”ç¦»ï¼Œéœ€è¦æƒè¡¡
- privilegedæ¨¡å¼åŠŸèƒ½å¼ºå¤§ä½†å®‰å…¨é£é™©æé«˜
- å®‰å…¨å®¹å™¨æŠ€æœ¯æ˜¯äº‘åŸç”Ÿå®‰å…¨çš„å‘å±•æ–¹å‘