---
title: 14ã€æ¨¡æ¿åˆ¶ä½œä¸é•œåƒå®šåˆ¶
---
## ğŸ“š ç›®å½•


1. [äº‘é•œåƒåˆ¶ä½œæ¦‚è¿°](#1-äº‘é•œåƒåˆ¶ä½œæ¦‚è¿°)
2. [æ¨¡æ¿è™šæ‹Ÿæœºå‡†å¤‡](#2-æ¨¡æ¿è™šæ‹Ÿæœºå‡†å¤‡)
3. [cloud-inité¢„é…ç½®](#3-cloud-inité¢„é…ç½®)
4. [é•œåƒæ¸…ç†ä¸ä¼˜åŒ–](#4-é•œåƒæ¸…ç†ä¸ä¼˜åŒ–)
5. [æ¨¡æ¿å°è£…ä¸å‘å¸ƒ](#5-æ¨¡æ¿å°è£…ä¸å‘å¸ƒ)
6. [é•œåƒç‰ˆæœ¬ç®¡ç†](#6-é•œåƒç‰ˆæœ¬ç®¡ç†)
7. [è‡ªåŠ¨åŒ–æ„å»ºæµç¨‹](#7-è‡ªåŠ¨åŒ–æ„å»ºæµç¨‹)
8. [é•œåƒæµ‹è¯•éªŒè¯](#8-é•œåƒæµ‹è¯•éªŒè¯)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ äº‘é•œåƒåˆ¶ä½œæ¦‚è¿°



### 1.1 ä»€ä¹ˆæ˜¯äº‘é•œåƒæ¨¡æ¿



**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼šäº‘é•œåƒæ¨¡æ¿å°±åƒæ˜¯**è£…ä¿®å¥½çš„æ ·æ¿æˆ¿**
- æ ·æ¿æˆ¿è£…å¥½äº†åŸºç¡€è®¾æ–½ï¼ˆæ°´ç”µã€åœ°æ¿ã€å¢™é¢ï¼‰
- è´­æˆ¿è€…æ‹¿åˆ°é’¥åŒ™å°±èƒ½ç›´æ¥å…¥ä½
- äº‘é•œåƒæ¨¡æ¿åŒ…å«äº†æ“ä½œç³»ç»Ÿã€åŸºç¡€è½¯ä»¶ã€é…ç½®
- ç”¨æˆ·åŸºäºæ¨¡æ¿åˆ›å»ºè™šæ‹Ÿæœºå°±èƒ½ç«‹å³ä½¿ç”¨

**ğŸ” æ ¸å¿ƒå®šä¹‰**
```
äº‘é•œåƒæ¨¡æ¿ï¼šé¢„å…ˆé…ç½®å¥½çš„è™šæ‹Ÿæœºé•œåƒæ–‡ä»¶
ä½œç”¨ï¼šå¿«é€Ÿéƒ¨ç½²æ ‡å‡†åŒ–çš„è™šæ‹Ÿæœºå®ä¾‹
åŒ…å«ï¼šæ“ä½œç³»ç»Ÿ + åŸºç¡€è½¯ä»¶ + åˆå§‹é…ç½® + cloud-init
```

### 1.2 åˆ¶ä½œäº‘é•œåƒçš„ä»·å€¼



**âš¡ æ•ˆç‡æå‡**
```
ä¼ ç»Ÿæ–¹å¼ï¼š
åˆ›å»ºè™šæ‹Ÿæœº â†’ å®‰è£…æ“ä½œç³»ç»Ÿ(30åˆ†é’Ÿ) â†’ å®‰è£…è½¯ä»¶(1å°æ—¶) â†’ é…ç½®ç³»ç»Ÿ(30åˆ†é’Ÿ)
æ€»è€—æ—¶ï¼šçº¦2å°æ—¶

äº‘é•œåƒæ–¹å¼ï¼š
åŸºäºæ¨¡æ¿åˆ›å»º â†’ è‡ªåŠ¨å®Œæˆåˆå§‹åŒ–(3-5åˆ†é’Ÿ)
æ€»è€—æ—¶ï¼šçº¦5åˆ†é’Ÿ

æ•ˆç‡æå‡ï¼š24å€ï¼
```

**ğŸ¯ æ ‡å‡†åŒ–ä»·å€¼**
- **ç¯å¢ƒä¸€è‡´æ€§**ï¼šæ‰€æœ‰è™šæ‹Ÿæœºéƒ½åŸºäºåŒä¸€æ¨¡æ¿ï¼Œç¯å¢ƒå®Œå…¨ä¸€è‡´
- **é…ç½®è§„èŒƒ**ï¼šå®‰å…¨è®¾ç½®ã€ç›‘æ§å·¥å…·ã€æ—¥å¿—é…ç½®ç­‰æ ‡å‡†åŒ–
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ¨¡æ¿ç‰ˆæœ¬åŒ–ç®¡ç†ï¼Œå¯å›æ»šå’Œè¿½è¸ªå˜æ›´

### 1.3 äº‘é•œåƒåˆ¶ä½œæ•´ä½“æµç¨‹



```
é•œåƒåˆ¶ä½œå®Œæ•´æµç¨‹ï¼š

å‡†å¤‡é˜¶æ®µ â”€â”€â”
           â”œâ”€â”€> æ¨¡æ¿è™šæ‹Ÿæœºå‡†å¤‡
           â”œâ”€â”€> æ“ä½œç³»ç»Ÿå®‰è£…
           â””â”€â”€> åŸºç¡€è½¯ä»¶å®‰è£…

é…ç½®é˜¶æ®µ â”€â”€â”  
           â”œâ”€â”€> cloud-inité…ç½®
           â”œâ”€â”€> ç³»ç»Ÿä¼˜åŒ–è®¾ç½®
           â””â”€â”€> å®‰å…¨åŠ å›ºé…ç½®

æ¸…ç†é˜¶æ®µ â”€â”€â”
           â”œâ”€â”€> å†å²æ•°æ®æ¸…ç†
           â”œâ”€â”€> ä¸´æ—¶æ–‡ä»¶åˆ é™¤
           â””â”€â”€> ä¸ªæ€§åŒ–ä¿¡æ¯ç§»é™¤

å°è£…é˜¶æ®µ â”€â”€â”
           â”œâ”€â”€> è™šæ‹Ÿæœºå…³æœº
           â”œâ”€â”€> é•œåƒæ–‡ä»¶å¯¼å‡º
           â””â”€â”€> æ¨¡æ¿æ³¨å†Œå‘å¸ƒ

éªŒè¯é˜¶æ®µ â”€â”€â”
           â”œâ”€â”€> åŠŸèƒ½æµ‹è¯•
           â”œâ”€â”€> æ€§èƒ½éªŒè¯
           â””â”€â”€> å…¼å®¹æ€§æ£€æŸ¥
```

---

## 2. ğŸ”§ æ¨¡æ¿è™šæ‹Ÿæœºå‡†å¤‡



### 2.1 åŸºç¡€ç¯å¢ƒæ­å»º



**ğŸ“‹ ç¡¬ä»¶è§„æ ¼è®¾ç½®**
```
æ¨èé…ç½®ï¼š
CPUï¼š2æ ¸å¿ƒï¼ˆåˆ¶ä½œè¿‡ç¨‹éœ€è¦ä¸€å®šæ€§èƒ½ï¼‰
å†…å­˜ï¼š2GB-4GBï¼ˆé¿å…åˆ¶ä½œè¿‡ç¨‹å¡é¡¿ï¼‰
ç¡¬ç›˜ï¼š20GB-40GBï¼ˆæ ¹æ®ç”¨é€”ç¡®å®šï¼‰
ç½‘ç»œï¼šæ¡¥æ¥æ¨¡å¼ï¼ˆä¾¿äºè½¯ä»¶ä¸‹è½½å’Œæ›´æ–°ï¼‰

ğŸ’¡ å°è´´å£«ï¼š
åˆ¶ä½œå®Œæˆåï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è¿™äº›è§„æ ¼
é‡ç‚¹æ˜¯ç¡®ä¿åˆ¶ä½œè¿‡ç¨‹é¡ºç•…
```

**ğŸ” æ“ä½œç³»ç»Ÿé€‰æ‹©åŸåˆ™**
- **ä¸»æµå‘è¡Œç‰ˆ**ï¼šCentOSã€Ubuntuã€Debianç­‰
- **LTSç‰ˆæœ¬**ï¼šé€‰æ‹©é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œç¨³å®šæ€§æ›´å¥½
- **æœ€å°åŒ–å®‰è£…**ï¼šåªå®‰è£…å¿…è¦ç»„ä»¶ï¼Œä¿æŒé•œåƒç²¾ç®€

### 2.2 æ“ä½œç³»ç»Ÿå®‰è£…è¦ç‚¹



**âš™ï¸ åˆ†åŒºè§„åˆ’å»ºè®®**
```
æ¨èåˆ†åŒºæ–¹æ¡ˆï¼š
/boot     ï¼š500MB   (å¼•å¯¼åˆ†åŒº)
/         ï¼šå‰©ä½™ç©ºé—´ (æ ¹åˆ†åŒºï¼Œä½¿ç”¨LVM)
swap      ï¼š1-2GB   (äº¤æ¢åˆ†åŒº)

ä¼˜åŠ¿è¯´æ˜ï¼š
- ç®€å•åˆ†åŒºç»“æ„ï¼Œä¾¿äºåç»­æ‰©å®¹
- LVMæ”¯æŒåŠ¨æ€è°ƒæ•´åˆ†åŒºå¤§å°
- ç”¨æˆ·å¯æ ¹æ®éœ€è¦è‡ªç”±è°ƒæ•´
```

**ğŸ” åˆå§‹å®‰å…¨é…ç½®**
```
âœ… å¿…åšé…ç½®ï¼š
- ç¦ç”¨rootç›´æ¥SSHç™»å½•
- åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·å¹¶åŠ å…¥sudoç»„
- é…ç½®é˜²ç«å¢™åŸºç¡€è§„åˆ™
- å¼€å¯SELinuxï¼ˆCentOS/RHELï¼‰
- è®¾ç½®åˆç†çš„å¯†ç ç­–ç•¥

âŒ é¿å…é…ç½®ï¼š
- ä¸è¦è®¾ç½®å›ºå®šIPåœ°å€
- ä¸è¦é…ç½®å…·ä½“çš„ä¸»æœºå
- ä¸è¦åˆ›å»ºä¸šåŠ¡ç›¸å…³ç”¨æˆ·
```

### 2.3 åŸºç¡€è½¯ä»¶åŒ…å®‰è£…



**ğŸ“¦ å¿…è£…è½¯ä»¶æ¸…å•**
```bash
# ç³»ç»Ÿç®¡ç†å·¥å…·

yum install -y vim wget curl htop tree

# ç½‘ç»œå·¥å…·  

yum install -y net-tools telnet traceroute

# å¼€å‘å·¥å…·ï¼ˆæŒ‰éœ€ï¼‰

yum install -y gcc make git

# ç›‘æ§ä»£ç†ï¼ˆæŒ‰ä¼ä¸šéœ€æ±‚ï¼‰

# å¦‚ï¼šzabbix-agentã€node_exporterç­‰

```

> ğŸ’¡ **å®‰è£…åŸåˆ™**  
> åªå®‰è£…é€šç”¨å¿…éœ€çš„è½¯ä»¶ï¼Œç‰¹æ®Šè½¯ä»¶è®©ç”¨æˆ·åç»­å®‰è£…
> è¿™æ ·ä¿æŒé•œåƒç²¾ç®€ï¼Œé€‚ç”¨æ€§æ›´å¹¿

**ğŸ”„ ç³»ç»Ÿæ›´æ–°ç­–ç•¥**
```bash
# æ›´æ–°åˆ°æœ€æ–°è¡¥ä¸

yum update -y

# æ¸…ç†ç¼“å­˜ï¼ˆé‡è¦ï¼ï¼‰

yum clean all
rm -rf /var/cache/yum/*
```

---

## 3. â˜ï¸ cloud-inité¢„é…ç½®



### 3.1 cloud-initæ ¸å¿ƒä½œç”¨ç†è§£



**ğŸ” ä»€ä¹ˆæ˜¯cloud-init**
```
cloud-initï¼šäº‘å®ä¾‹åˆå§‹åŒ–å·¥å…·
ä½œç”¨ï¼šè™šæ‹Ÿæœºé¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–ä»»åŠ¡
ç±»æ¯”ï¼šæ–°å‘˜å·¥å…¥èŒè‡ªåŠ¨åŒ–æµç¨‹

ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹åŠ¨é…ç½®æ¯å°æœºå™¨
cloud-initï¼šæ¨¡æ¿+æ•°æ® = è‡ªåŠ¨åŒ–é…ç½®
```

**âš¡ cloud-initçš„å·¥ä½œæ—¶æœº**
```
è™šæ‹Ÿæœºå¯åŠ¨æµç¨‹ï¼š
å¯åŠ¨ â†’ å†…æ ¸åŠ è½½ â†’ cloud-initè¿è¡Œ â†’ ç”¨æˆ·ç™»å½•

cloud-initå››ä¸ªé˜¶æ®µï¼š
1. cloud-init-localï¼šæœ¬åœ°é…ç½®ï¼ˆç½‘ç»œå‰ï¼‰
2. cloud-initï¼šç½‘ç»œé…ç½®  
3. cloud-configï¼šè½¯ä»¶å®‰è£…ã€ç”¨æˆ·åˆ›å»º
4. cloud-finalï¼šæœ€ç»ˆè„šæœ¬æ‰§è¡Œ
```

### 3.2 cloud-initå®‰è£…ä¸å¯ç”¨



**ğŸ“¦ å®‰è£…cloud-init**
```bash
# CentOS/RHEL

yum install -y cloud-init

# Ubuntu/Debian  

apt-get install -y cloud-init

# å¯ç”¨ç›¸å…³æœåŠ¡

systemctl enable cloud-init
systemctl enable cloud-init-local
systemctl enable cloud-config
systemctl enable cloud-final
```

### 3.3 cloud-inité…ç½®æ–‡ä»¶å®šåˆ¶



**ğŸ“ ä¸»é…ç½®æ–‡ä»¶ï¼š`/etc/cloud/cloud.cfg`**
```yaml
# æ•°æ®æºé…ç½®ï¼ˆå‘Šè¯‰cloud-initä»å“ªè·å–æ•°æ®ï¼‰

datasource_list: 
  - ConfigDrive
  - NoCloud
  - OpenStack

# é»˜è®¤ç”¨æˆ·é…ç½®

system_info:
  default_user:
    name: clouduser
    gecos: Cloud User
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]
    shell: /bin/bash

# æ¨¡å—é…ç½®ï¼ˆå®šä¹‰è¦æ‰§è¡Œçš„åŠŸèƒ½ï¼‰

cloud_init_modules:
  - bootcmd
  - write-files
  - set_hostname
  - update_hostname
  - users-groups
  - ssh

cloud_config_modules:
  - ssh-import-id
  - locale
  - set-passwords
  - timezone
  - disable-ec2-metadata
  - runcmd

cloud_final_modules:
  - package-update-upgrade-install
  - scripts-vendor
  - scripts-per-once
  - scripts-per-boot
  - scripts-per-instance
  - scripts-user
  - ssh-authkey-fingerprints
  - final-message
```

> ğŸ“– **é…ç½®è¯´æ˜**  
> - `datasource_list`ï¼šå®šä¹‰æ•°æ®æ¥æºä¼˜å…ˆçº§
> - `default_user`ï¼šé»˜è®¤åˆ›å»ºçš„ç”¨æˆ·ï¼ˆé¿å…ä½¿ç”¨rootï¼‰
> - `*_modules`ï¼šä¸åŒé˜¶æ®µæ‰§è¡Œçš„åŠŸèƒ½æ¨¡å—

**ğŸ”§ ç½‘ç»œé…ç½®æ¨¡æ¿**
```yaml
# /etc/cloud/cloud.cfg.d/99-network.cfg

network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      dhcp4: true
      dhcp6: false
```

### 3.4 cloud-initæ•°æ®æºé…ç½®



**ğŸ’¾ æ”¯æŒçš„æ•°æ®æºç±»å‹**
```
å¸¸è§æ•°æ®æºï¼š
ğŸ”¸ NoCloudï¼šæœ¬åœ°æ–‡ä»¶æˆ–CD-ROM
ğŸ”¸ ConfigDriveï¼šè™šæ‹Ÿå…‰é©±æ–¹å¼
ğŸ”¸ OpenStackï¼šOpenStackå…ƒæ•°æ®æœåŠ¡  
ğŸ”¸ EC2ï¼šAWSå…ƒæ•°æ®æœåŠ¡
ğŸ”¸ Azureï¼šAzureå…ƒæ•°æ®æœåŠ¡

ä¼ä¸šç§æœ‰äº‘å¸¸ç”¨ï¼šNoCloudã€ConfigDrive
```

**ğŸ“‹ NoCloudæ•°æ®æºç¤ºä¾‹**
```bash
# åˆ›å»ºç”¨æˆ·æ•°æ®æ–‡ä»¶

cat > /var/lib/cloud/seed/nocloud/user-data << 'EOF'
#cloud-config

users:
  - name: admin
    ssh-authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2E... user@example.com
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    groups: wheel

hostname: template-vm
timezone: Asia/Shanghai

packages:
  - htop
  - git

runcmd:
  - echo "Cloud-init completed" >> /var/log/cloud-init-custom.log
EOF

# åˆ›å»ºå…ƒæ•°æ®æ–‡ä»¶  

cat > /var/lib/cloud/seed/nocloud/meta-data << 'EOF'
instance-id: template-001
local-hostname: template-vm
EOF
```

---

## 4. ğŸ§¹ é•œåƒæ¸…ç†ä¸ä¼˜åŒ–



### 4.1 ä¸ºä»€ä¹ˆè¦æ¸…ç†é•œåƒ



**ğŸ¯ æ¸…ç†çš„é‡è¦æ€§**
```
æ¸…ç†å‰é—®é¢˜ï¼š
- é•œåƒæ–‡ä»¶è¿‡å¤§ï¼Œä¼ è¾“æ…¢
- åŒ…å«ä¸ªäººä¿¡æ¯ï¼Œå®‰å…¨é£é™©
- å†å²æ•°æ®å¹²æ‰°ï¼Œå¯åŠ¨å¼‚å¸¸
- ç£ç›˜ç©ºé—´æµªè´¹

æ¸…ç†åæ•ˆæœï¼š
- é•œåƒä½“ç§¯ç¼©å°50-70%
- æ— ä¸ªäººä¿¡æ¯æ³„éœ²
- å¯åŠ¨é€Ÿåº¦æ›´å¿«
- æ ‡å‡†åŒ–ç¨‹åº¦æ›´é«˜
```

### 4.2 ç³»ç»Ÿå†å²æ•°æ®æ¸…ç†



**ğŸ“ æ—¥å¿—æ–‡ä»¶æ¸…ç†**
```bash
# æ¸…ç†ç³»ç»Ÿæ—¥å¿—

> /var/log/messages
> /var/log/secure  
> /var/log/cron
> /var/log/maillog

# æ¸…ç†åº”ç”¨æ—¥å¿—

rm -rf /var/log/*.log
rm -rf /var/log/*/*.log

# æ¸…ç†journalæ—¥å¿—ï¼ˆsystemdï¼‰

journalctl --vacuum-time=1d
```

**ğŸ”‘ SSHç›¸å…³æ¸…ç†**
```bash
# åˆ é™¤SSHä¸»æœºå¯†é’¥ï¼ˆé‡è¦ï¼ï¼‰

rm -f /etc/ssh/ssh_host_*

# æ¸…ç†SSHå®¢æˆ·ç«¯å†å²

rm -f /root/.ssh/known_hosts
rm -f /home/*/.ssh/known_hosts

# æ¸…ç†ç”¨æˆ·ç™»å½•å†å²

> /var/log/wtmp
> /var/log/btmp
> /var/log/lastlog
```

**ğŸ“Š å‘½ä»¤å†å²æ¸…ç†**
```bash
# æ¸…ç†bashå†å²

> /root/.bash_history
rm -f /home/*/.bash_history

# æ¸…ç†å…¶ä»–shellå†å²

> /root/.zsh_history
rm -f /home/*/.zsh_history
```

### 4.3 ä¸´æ—¶æ–‡ä»¶ä¸ç¼“å­˜æ¸…ç†



**ğŸ—‚ï¸ ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶**
```bash
# æ¸…ç†ä¸´æ—¶ç›®å½•

rm -rf /tmp/*
rm -rf /var/tmp/*

# æ¸…ç†é‚®ä»¶é˜Ÿåˆ—

rm -rf /var/spool/mail/*

# æ¸…ç†è®¡åˆ’ä»»åŠ¡ä¸´æ—¶æ–‡ä»¶

rm -rf /var/spool/cron/*
```

**ğŸ“¦ åŒ…ç®¡ç†å™¨ç¼“å­˜**
```bash
# CentOS/RHEL

yum clean all
rm -rf /var/cache/yum/*

# Ubuntu/Debian

apt-get clean
rm -rf /var/cache/apt/*
rm -rf /var/lib/apt/lists/*

# æ¸…ç†è½¯ä»¶åŒ…ç¼“å­˜ç›®å½•

rm -rf /var/cache/dnf/*
```

### 4.4 ç½‘ç»œä¸ç¡¬ä»¶ä¿¡æ¯æ¸…ç†



**ğŸŒ ç½‘ç»œé…ç½®æ¸…ç†**
```bash
# æ¸…ç†ç½‘ç»œæ¥å£æŒä¹…åŒ–è§„åˆ™ï¼ˆé‡è¦ï¼ï¼‰

rm -f /etc/udev/rules.d/70-persistent-net.rules

# æ¸…ç†NetworkManagerè¿æ¥è®°å½•

rm -rf /etc/NetworkManager/system-connections/*

# æ¸…ç†DHCPå®¢æˆ·ç«¯ç§Ÿçº¦

rm -f /var/lib/dhcp/*
rm -f /var/lib/dhclient/*
```

**ğŸ’» æœºå™¨æ ‡è¯†æ¸…ç†**
```bash
# æ¸…ç†æœºå™¨IDï¼ˆè®©æ¯ä¸ªå®ä¾‹æœ‰å”¯ä¸€IDï¼‰

rm -f /etc/machine-id
touch /etc/machine-id

# æ¸…ç†systemdæœºå™¨ID

rm -f /var/lib/dbus/machine-id
ln -s /etc/machine-id /var/lib/dbus/machine-id
```

### 4.5 ç£ç›˜ç©ºé—´ä¼˜åŒ–



**ğŸ’¾ ç£ç›˜é›¶å¡«å……ä¼˜åŒ–**
```bash
# åˆ›å»ºé›¶å¡«å……æ–‡ä»¶å æ»¡å‰©ä½™ç©ºé—´

dd if=/dev/zero of=/EMPTY bs=1M
rm -f /EMPTY

# è¿™ä¸ªæ“ä½œçš„ä½œç”¨ï¼š

# 1. å°†æœªä½¿ç”¨çš„ç£ç›˜å—å¡«å……ä¸º0

# 2. å‹ç¼©æ—¶å¯ä»¥è·å¾—æ›´å¥½çš„å‹ç¼©ç‡

# 3. å‡å°æœ€ç»ˆé•œåƒæ–‡ä»¶å¤§å°

```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> é›¶å¡«å……æ“ä½œä¼šæš‚æ—¶å æ»¡ç£ç›˜ç©ºé—´ï¼Œç¡®ä¿æ“ä½œå‰æœ‰è¶³å¤Ÿç©ºé—´
> æ“ä½œå®ŒæˆååŠ¡å¿…åˆ é™¤é›¶å¡«å……æ–‡ä»¶

---

## 5. ğŸ“¦ æ¨¡æ¿å°è£…ä¸å‘å¸ƒ



### 5.1 è™šæ‹Ÿæœºå…³æœºå‰å‡†å¤‡



**ğŸ”„ æœ€ç»ˆæ£€æŸ¥æ¸…å•**
```bash
# 1. ç¡®è®¤cloud-initæœåŠ¡çŠ¶æ€

systemctl is-enabled cloud-init

# 2. æ£€æŸ¥é‡è¦é…ç½®æ–‡ä»¶

ls -la /etc/cloud/
cat /etc/cloud/cloud.cfg | grep datasource

# 3. éªŒè¯æ¸…ç†æ•ˆæœ

du -sh /var/log/*
ls -la /tmp/

# 4. æµ‹è¯•ç½‘ç»œé…ç½®

ip addr show
```

**ğŸ”§ å…³æœºå‰æœ€åé…ç½®**
```bash
# è®¾ç½®ä¸‹æ¬¡å¯åŠ¨é‡æ–°ç”ŸæˆSSHå¯†é’¥

systemctl enable sshd-keygen@rsa
systemctl enable sshd-keygen@ecdsa
systemctl enable sshd-keygen@ed25519

# ç¡®ä¿cloud-initä¸‹æ¬¡å¯åŠ¨æ‰§è¡Œ

cloud-init clean --logs --reboot
```

### 5.2 é•œåƒå¯¼å‡ºä¸æ ¼å¼è½¬æ¢



**ğŸ’¾ å¸¸è§é•œåƒæ ¼å¼å¯¹æ¯”**

| æ ¼å¼ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å‹ç¼©ç‡** |
|------|---------|-------------|-----------|
| `RAW` | `åŸå§‹ç£ç›˜æ ¼å¼ï¼Œå…¼å®¹æ€§æœ€å¥½` | `ç”Ÿäº§ç¯å¢ƒã€æ€§èƒ½è¦æ±‚é«˜` | `ä½` |
| `QCOW2` | `æ”¯æŒå¿«ç…§ã€å‹ç¼©ã€åŠ å¯†` | `å¼€å‘æµ‹è¯•ã€å­˜å‚¨ä¼˜åŒ–` | `é«˜` |
| `VMDK` | `VMwareåŸç”Ÿæ ¼å¼` | `VMwareç¯å¢ƒ` | `ä¸­` |
| `VDI` | `VirtualBoxæ ¼å¼` | `VirtualBoxç¯å¢ƒ` | `ä¸­` |

**ğŸ”§ é•œåƒæ ¼å¼è½¬æ¢å‘½ä»¤**
```bash
# VMDKè½¬QCOW2ï¼ˆå¸¸ç”¨ï¼‰

qemu-img convert -f vmdk -O qcow2 source.vmdk target.qcow2

# RAWè½¬QCOW2å¹¶å‹ç¼©

qemu-img convert -f raw -O qcow2 -c source.raw target.qcow2

# æŸ¥çœ‹é•œåƒä¿¡æ¯

qemu-img info target.qcow2
```

### 5.3 é•œåƒä¸Šä¼ ä¸æ³¨å†Œ



**â˜ï¸ OpenStackç¯å¢ƒå‘å¸ƒ**
```bash
# ä¸Šä¼ é•œåƒåˆ°OpenStack

openstack image create \
  --file centos7-template.qcow2 \
  --disk-format qcow2 \
  --container-format bare \
  --property os_distro=centos \
  --property os_version=7 \
  --public \
  "CentOS-7-Template"

# éªŒè¯é•œåƒçŠ¶æ€

openstack image show CentOS-7-Template
```

**ğŸ¢ ä¼ä¸šç§æœ‰äº‘å‘å¸ƒ**
```bash
# ä¸Šä¼ åˆ°å…±äº«å­˜å‚¨

scp centos7-template.qcow2 admin@storage:/images/

# æ³¨å†Œåˆ°è™šæ‹ŸåŒ–ç®¡ç†å¹³å°

# å…·ä½“å‘½ä»¤ä¾èµ–ä½¿ç”¨çš„è™šæ‹ŸåŒ–å¹³å°

# å¦‚ï¼šoVirtã€Proxmoxã€VMware vSphereç­‰

```

---

## 6. ğŸ“ˆ é•œåƒç‰ˆæœ¬ç®¡ç†



### 6.1 ç‰ˆæœ¬å·å‘½åè§„èŒƒ



**ğŸ·ï¸ æ¨èå‘½åè§„èŒƒ**
```
æ ¼å¼ï¼šOS-VERSION-TEMPLATE-YYYYMMDD-BUILD

ç¤ºä¾‹ï¼š
CentOS-7.9-Web-20240315-001
Ubuntu-20.04-DB-20240315-002
RHEL-8.6-K8s-20240315-001

å«ä¹‰è¯´æ˜ï¼š
- OSï¼šæ“ä½œç³»ç»Ÿç±»å‹
- VERSIONï¼šæ“ä½œç³»ç»Ÿç‰ˆæœ¬
- TEMPLATEï¼šæ¨¡æ¿ç”¨é€”æ ‡è¯†
- YYYYMMDDï¼šæ„å»ºæ—¥æœŸ
- BUILDï¼šå½“æ—¥æ„å»ºåºå·
```

**ğŸ“‹ ç‰ˆæœ¬ä¿¡æ¯è®°å½•**
```bash
# åœ¨é•œåƒä¸­è®°å½•ç‰ˆæœ¬ä¿¡æ¯

cat > /etc/image-info << EOF
IMAGE_NAME=CentOS-7.9-Web-20240315-001
BUILD_DATE=$(date "+%Y-%m-%d %H:%M:%S")
BUILD_USER=$(whoami)
OS_VERSION=$(cat /etc/redhat-release)
CLOUD_INIT_VERSION=$(cloud-init --version)
PACKAGES_LIST=/root/installed-packages.txt
EOF

# è®°å½•å®‰è£…çš„è½¯ä»¶åŒ…

rpm -qa | sort > /root/installed-packages.txt
```

### 6.2 ç‰ˆæœ¬å˜æ›´ç®¡ç†



**ğŸ“ å˜æ›´æ—¥å¿—æ¨¡æ¿**
```markdown
# é•œåƒå˜æ›´æ—¥å¿—


# CentOS-7.9-Web-20240315-001



## æ–°å¢åŠŸèƒ½


- é›†æˆnginx 1.20
- æ·»åŠ ç›‘æ§ä»£ç†zabbix-agent
- é¢„è£…SSLè¯ä¹¦ç®¡ç†å·¥å…·

## ä¼˜åŒ–æ”¹è¿›  


- ä¼˜åŒ–å†…æ ¸å‚æ•°é…ç½®
- æ›´æ–°å®‰å…¨è¡¥ä¸åˆ°æœ€æ–°
- å‡å°é•œåƒä½“ç§¯15%

## ä¿®å¤é—®é¢˜


- ä¿®å¤cloud-initç½‘ç»œé…ç½®é—®é¢˜
- è§£å†³æ—¶åŒºè®¾ç½®å¼‚å¸¸

## å…¼å®¹æ€§è¯´æ˜


- å‘ä¸‹å…¼å®¹ä¸Šä¸€ç‰ˆæœ¬é…ç½®
- å»ºè®®ä½¿ç”¨cloud-init 20.xä»¥ä¸Šç‰ˆæœ¬
```

### 6.3 ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸç®¡ç†



**â° ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸç­–ç•¥**
```
ç‰ˆæœ¬çŠ¶æ€å®šä¹‰ï¼š
ğŸŸ¢ Currentï¼šå½“å‰æ¨èç‰ˆæœ¬
ğŸŸ¡ Supportedï¼šæ”¯æŒç‰ˆæœ¬ï¼ˆ1-2ä¸ªï¼‰  
ğŸ”´ Deprecatedï¼šåºŸå¼ƒç‰ˆæœ¬ï¼ˆ6ä¸ªæœˆååˆ é™¤ï¼‰
âš« EOLï¼šç”Ÿå‘½å‘¨æœŸç»“æŸï¼ˆä¸å†æ”¯æŒï¼‰

ç”Ÿå‘½å‘¨æœŸæ—¶é—´çº¿ï¼š
å‘å¸ƒ â”€â”€3ä¸ªæœˆâ”€â”€> Supported â”€â”€6ä¸ªæœˆâ”€â”€> Deprecated â”€â”€3ä¸ªæœˆâ”€â”€> EOL
```

---

## 7. ğŸ¤– è‡ªåŠ¨åŒ–æ„å»ºæµç¨‹



### 7.1 è‡ªåŠ¨åŒ–æ„å»ºçš„ä»·å€¼



**âš¡ è‡ªåŠ¨åŒ– vs æ‰‹å·¥åˆ¶ä½œ**
```
æ‰‹å·¥åˆ¶ä½œé—®é¢˜ï¼š
- è€—æ—¶é•¿ï¼šæ¯æ¬¡2-4å°æ—¶
- æ˜“å‡ºé”™ï¼šæ­¥éª¤å¤æ‚å®¹æ˜“é—æ¼  
- ä¸ä¸€è‡´ï¼šä¸åŒäººåˆ¶ä½œæœ‰å·®å¼‚
- éš¾è¿½è¸ªï¼šæ— æ³•è®°å½•åˆ¶ä½œè¿‡ç¨‹

è‡ªåŠ¨åŒ–æ„å»ºä¼˜åŠ¿ï¼š
- å¿«é€Ÿï¼š20-30åˆ†é’Ÿå®Œæˆ
- å‡†ç¡®ï¼šæ ‡å‡†åŒ–æµç¨‹æ— é—æ¼
- ä¸€è‡´ï¼šæ¯æ¬¡ç»“æœå®Œå…¨ç›¸åŒ
- å¯è¿½è¸ªï¼šå®Œæ•´çš„æ„å»ºæ—¥å¿—
```

### 7.2 æ„å»ºå·¥å…·é€‰æ‹©



**ğŸ”§ ä¸»æµæ„å»ºå·¥å…·å¯¹æ¯”**

| å·¥å…· | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å­¦ä¹ æˆæœ¬** |
|------|---------|-------------|-------------|
| `Packer` | `ä¸“ä¸šé•œåƒæ„å»ºå·¥å…·` | `å¤šäº‘ç¯å¢ƒã€ä¼ä¸šçº§` | `ä¸­ç­‰` |
| `Ansible` | `é…ç½®ç®¡ç†+æ„å»º` | `å·²æœ‰AnsibleåŸºç¡€` | `ä½` |
| `Terraform` | `åŸºç¡€è®¾æ–½å³ä»£ç ` | `å®Œæ•´äº‘ç¯å¢ƒç®¡ç†` | `é«˜` |
| `è„šæœ¬` | `Shell/Pythonè‡ªå®šä¹‰` | `ç®€å•åœºæ™¯ã€å¿«é€Ÿä¸Šæ‰‹` | `ä½` |

### 7.3 Packerè‡ªåŠ¨åŒ–æ„å»ºç¤ºä¾‹



**ğŸ“„ Packeré…ç½®æ–‡ä»¶ç¤ºä¾‹**
```json
{
  "builders": [{
    "type": "qemu",
    "iso_url": "http://mirrors.aliyun.com/centos/7/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso",
    "iso_checksum": "sha256:07b94e6b1a0b0260b94c83d6bb76b26bf7a310dc78d7a9c7432809fb9bc6194a",
    "output_directory": "output-centos7",
    "shutdown_command": "echo 'packer' | sudo -S shutdown -P now",
    "disk_size": "20480",
    "format": "qcow2",
    "headless": false,
    "accelerator": "kvm",
    "http_directory": "http",
    "http_port_min": 10082,
    "http_port_max": 10089,
    "ssh_host_port_min": 2222,
    "ssh_host_port_max": 2229,
    "ssh_username": "root",
    "ssh_password": "packer",
    "ssh_port": 22,
    "ssh_wait_timeout": "90s",
    "vm_name": "centos7-template",
    "net_device": "virtio-net",
    "disk_interface": "virtio",
    "boot_wait": "10s",
    "boot_command": [
      "<tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks.cfg<enter><wait>"
    ]
  }],
  "provisioners": [
    {
      "type": "shell",
      "script": "scripts/setup.sh"
    },
    {
      "type": "shell",
      "script": "scripts/cleanup.sh"
    }
  ]
}
```

**ğŸ”§ é…ç½®è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash

# scripts/setup.sh - ç³»ç»Ÿé…ç½®è„šæœ¬


# æ›´æ–°ç³»ç»Ÿ

yum update -y

# å®‰è£…åŸºç¡€è½¯ä»¶

yum install -y vim wget curl htop cloud-init

# é…ç½®cloud-init

systemctl enable cloud-init

# å®‰å…¨é…ç½®

sed -i 's/#PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config

echo "Setup completed"
```

### 7.4 CI/CDé›†æˆæ„å»º



**ğŸ”„ Jenkinsæ„å»ºæµæ°´çº¿ç¤ºä¾‹**
```groovy
pipeline {
    agent any
    
    parameters {
        choice(
            name: 'OS_VERSION',
            choices: ['centos7', 'centos8', 'ubuntu20'],
            description: 'é€‰æ‹©æ“ä½œç³»ç»Ÿç‰ˆæœ¬'
        )
        string(
            name: 'BUILD_VERSION', 
            defaultValue: '',
            description: 'æ„å»ºç‰ˆæœ¬å·ï¼ˆç•™ç©ºè‡ªåŠ¨ç”Ÿæˆï¼‰'
        )
    }
    
    stages {
        stage('Prepare') {
            steps {
                script {
                    env.BUILD_DATE = sh(returnStdout: true, script: 'date +%Y%m%d').trim()
                    env.BUILD_NUMBER_TODAY = sh(returnStdout: true, script: 'find builds/ -name "*${BUILD_DATE}*" | wc -l').trim()
                    env.VERSION = params.BUILD_VERSION ?: "${params.OS_VERSION}-${env.BUILD_DATE}-${env.BUILD_NUMBER_TODAY.padLeft(3, '0')}"
                }
                echo "æ„å»ºç‰ˆæœ¬: ${env.VERSION}"
            }
        }
        
        stage('Build Image') {
            steps {
                sh "packer build -var 'version=${env.VERSION}' packer-${params.OS_VERSION}.json"
            }
        }
        
        stage('Test Image') {
            steps {
                sh "scripts/test-image.sh ${env.VERSION}"
            }
        }
        
        stage('Upload & Register') {
            steps {
                sh "scripts/upload-image.sh ${env.VERSION}"
            }
        }
    }
    
    post {
        success {
            archiveArtifacts artifacts: "output-*/${env.VERSION}.qcow2", fingerprint: true
            echo "é•œåƒæ„å»ºæˆåŠŸ: ${env.VERSION}"
        }
        failure {
            echo "é•œåƒæ„å»ºå¤±è´¥"
        }
    }
}
```

---

## 8. âœ… é•œåƒæµ‹è¯•éªŒè¯



### 8.1 åŠŸèƒ½æµ‹è¯•éªŒè¯



**ğŸ§ª åŸºç¡€åŠŸèƒ½æµ‹è¯•æ¸…å•**
```bash
# 1. å¯åŠ¨æµ‹è¯•

time qemu-system-x86_64 -m 1024 -hda test-image.qcow2

# 2. cloud-initåŠŸèƒ½æµ‹è¯•

# åˆ›å»ºæµ‹è¯•ç”¨æˆ·æ•°æ®

cat > user-data << EOF
#cloud-config

users:
  - name: testuser
    ssh-authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2E... test@example.com
    sudo: ['ALL=(ALL) NOPASSWD:ALL']

hostname: test-vm
packages:
  - htop

runcmd:
  - echo "Test completed" > /tmp/cloud-init-test.log
EOF

# ä½¿ç”¨NoCloudæ•°æ®æºæµ‹è¯•

genisoimage -output seed.iso -volid cidata -joliet -rock user-data meta-data
```

**ğŸ” éªŒè¯é¡¹ç›®æ£€æŸ¥**
```bash
#!/bin/bash

# test-image.sh - é•œåƒæµ‹è¯•è„šæœ¬


echo "=== é•œåƒåŠŸèƒ½æµ‹è¯• ==="

# 1. æ£€æŸ¥cloud-initæœåŠ¡

echo "æ£€æŸ¥cloud-initæœåŠ¡çŠ¶æ€..."
systemctl is-active cloud-init
systemctl is-enabled cloud-init

# 2. æ£€æŸ¥ç½‘ç»œé…ç½®

echo "æ£€æŸ¥ç½‘ç»œé…ç½®..."
ip addr show
ping -c 3 8.8.8.8

# 3. æ£€æŸ¥ç”¨æˆ·åˆ›å»º

echo "æ£€æŸ¥ç”¨æˆ·åˆ›å»º..."
id testuser
sudo -l -U testuser

# 4. æ£€æŸ¥è½¯ä»¶åŒ…å®‰è£…

echo "æ£€æŸ¥è½¯ä»¶åŒ…å®‰è£…..."
which htop

# 5. æ£€æŸ¥SSHé…ç½®

echo "æ£€æŸ¥SSHé…ç½®..."
sshd -T | grep permitrootlogin

# 6. æ£€æŸ¥å†å²æ•°æ®æ¸…ç†

echo "æ£€æŸ¥å†å²æ•°æ®æ¸…ç†..."
ls -la /var/log/messages
ls -la /root/.bash_history

echo "=== æµ‹è¯•å®Œæˆ ==="
```

### 8.2 æ€§èƒ½åŸºå‡†æµ‹è¯•



**âš¡ å¯åŠ¨æ€§èƒ½æµ‹è¯•**
```bash
# æµ‹è¯•å¯åŠ¨æ—¶é—´

#!/bin/bash

echo "æµ‹è¯•é•œåƒå¯åŠ¨æ€§èƒ½..."

start_time=$(date +%s)

# å¯åŠ¨è™šæ‹Ÿæœºå¹¶ç­‰å¾…SSHå¯ç”¨

qemu-system-x86_64 \
  -m 1024 \
  -hda test-image.qcow2 \
  -netdev user,id=net0,hostfwd=tcp::2222-:22 \
  -device virtio-net,netdev=net0 \
  -nographic &

VM_PID=$!

# ç­‰å¾…SSHæœåŠ¡å¯ç”¨

while ! nc -z localhost 2222; do
  sleep 1
  ((elapsed++))
  if [ $elapsed -gt 120 ]; then
    echo "å¯åŠ¨è¶…æ—¶"
    kill $VM_PID
    exit 1
  fi
done

end_time=$(date +%s)
boot_time=$((end_time - start_time))

echo "å¯åŠ¨æ—¶é—´: ${boot_time}ç§’"

# æ¸…ç†

kill $VM_PID
```

**ğŸ“Š èµ„æºå ç”¨æµ‹è¯•**
```bash
# å†…å­˜å ç”¨æµ‹è¯•

echo "=== å†…å­˜å ç”¨æƒ…å†µ ==="
free -h
ps aux --sort=-%mem | head -10

# ç£ç›˜å ç”¨æµ‹è¯•  

echo "=== ç£ç›˜å ç”¨æƒ…å†µ ==="
df -h
du -sh /var/log/*

# ç½‘ç»œæ€§èƒ½æµ‹è¯•

echo "=== ç½‘ç»œæ€§èƒ½æµ‹è¯• ==="
curl -o /dev/null -s -w "ä¸‹è½½é€Ÿåº¦: %{speed_download} bytes/sec\n" http://speedtest.tele2.net/1MB.zip
```

### 8.3 å…¼å®¹æ€§æµ‹è¯•



**ğŸ”§ å¤šè™šæ‹ŸåŒ–å¹³å°å…¼å®¹æ€§**
```bash
# KVM/QEMUæµ‹è¯•

qemu-system-x86_64 -m 1024 -hda image.qcow2

# VirtualBoxæµ‹è¯•  

VBoxManage import image.ova

# VMwareæµ‹è¯•

vmware-cmd image.vmx start

# OpenStackæµ‹è¯•

openstack server create --image test-image --flavor m1.small test-vm
```

**ğŸ“‹ å…¼å®¹æ€§æ£€æŸ¥æŠ¥å‘Šæ¨¡æ¿**
```markdown
# é•œåƒå…¼å®¹æ€§æµ‹è¯•æŠ¥å‘Š


# æµ‹è¯•ç¯å¢ƒ


- æµ‹è¯•æ—¥æœŸï¼š2024-03-15
- é•œåƒç‰ˆæœ¬ï¼šCentOS-7.9-Web-20240315-001
- æµ‹è¯•äººå‘˜ï¼šå¼ ä¸‰

# è™šæ‹ŸåŒ–å¹³å°å…¼å®¹æ€§


| å¹³å° | ç‰ˆæœ¬ | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|------|
| KVM/QEMU | 6.2 | âœ… é€šè¿‡ | å¯åŠ¨æ­£å¸¸ï¼Œæ€§èƒ½è‰¯å¥½ |
| VirtualBox | 6.1 | âœ… é€šè¿‡ | éœ€è¦å®‰è£…Guest Additions |
| VMware vSphere | 7.0 | âœ… é€šè¿‡ | å»ºè®®å¯ç”¨VMware Tools |
| OpenStack | Victoria | âœ… é€šè¿‡ | cloud-initåŠŸèƒ½æ­£å¸¸ |

# åŠŸèƒ½æµ‹è¯•ç»“æœ


- cloud-initåˆå§‹åŒ–ï¼šâœ… é€šè¿‡
- SSHå¯†é’¥æ³¨å…¥ï¼šâœ… é€šè¿‡  
- ç½‘ç»œè‡ªåŠ¨é…ç½®ï¼šâœ… é€šè¿‡
- ç”¨æˆ·åˆ›å»ºï¼šâœ… é€šè¿‡
- è½¯ä»¶åŒ…å®‰è£…ï¼šâœ… é€šè¿‡

# æ€§èƒ½æŒ‡æ ‡


- å¯åŠ¨æ—¶é—´ï¼š45ç§’
- å†…å­˜å ç”¨ï¼š380MB
- ç£ç›˜å¤§å°ï¼š1.2GB
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ



**ğŸ”¸ äº‘é•œåƒåˆ¶ä½œæœ¬è´¨**
```
æ ¸å¿ƒç†è§£ï¼š
äº‘é•œåƒ = æ“ä½œç³»ç»Ÿ + åŸºç¡€è½¯ä»¶ + cloud-init + æ ‡å‡†åŒ–é…ç½®
ç›®æ ‡ï¼šå¿«é€Ÿã€æ ‡å‡†åŒ–åœ°éƒ¨ç½²è™šæ‹Ÿæœºå®ä¾‹
ä»·å€¼ï¼šæ•ˆç‡æå‡24å€ï¼Œç¯å¢ƒ100%ä¸€è‡´
```

**ğŸ”¸ cloud-initæ ¸å¿ƒä½œç”¨**
```
ä½œç”¨æœºåˆ¶ï¼š
æ¨¡æ¿é•œåƒï¼ˆæ ‡å‡†é…ç½®ï¼‰+ ç”¨æˆ·æ•°æ®ï¼ˆä¸ªæ€§åŒ–ï¼‰= å®šåˆ¶åŒ–å®ä¾‹
å…³é”®é…ç½®ï¼šæ•°æ®æºã€é»˜è®¤ç”¨æˆ·ã€ç½‘ç»œã€æ¨¡å—
é‡è¦åŸåˆ™ï¼šæ¨¡æ¿ä¸­åªåšé€šç”¨é…ç½®ï¼Œä¸ªæ€§åŒ–ç•™ç»™ç”¨æˆ·æ•°æ®
```

**ğŸ”¸ é•œåƒæ¸…ç†é‡è¦æ€§**
```
æ¸…ç†ç›®æ ‡ï¼š
- ç§»é™¤ä¸ªäººä¿¡æ¯å’Œå†å²æ•°æ®
- å‡å°é•œåƒä½“ç§¯50-70%
- ç¡®ä¿æ¯ä¸ªå®ä¾‹çš„å”¯ä¸€æ€§
- æé«˜å¯åŠ¨é€Ÿåº¦å’Œç¨³å®šæ€§
```

### 9.2 åˆ¶ä½œæµç¨‹å…³é”®æ­¥éª¤



**ğŸ“‹ æ ‡å‡†åˆ¶ä½œæµç¨‹**
```
1. ç¯å¢ƒå‡†å¤‡ï¼šåˆç†çš„ç¡¬ä»¶é…ç½® + æœ€å°åŒ–å®‰è£…
2. è½¯ä»¶å®‰è£…ï¼šåªè£…é€šç”¨å¿…éœ€è½¯ä»¶ï¼Œä¿æŒç²¾ç®€
3. cloud-inité…ç½®ï¼šæ­£ç¡®çš„æ•°æ®æºå’Œæ¨¡å—é…ç½®
4. ç³»ç»Ÿæ¸…ç†ï¼šå½»åº•æ¸…ç†å†å²æ•°æ®å’Œä¸ªäººä¿¡æ¯
5. é•œåƒå°è£…ï¼šè½¬æ¢æ ¼å¼å¹¶å‹ç¼©ä¼˜åŒ–
6. æµ‹è¯•éªŒè¯ï¼šåŠŸèƒ½ã€æ€§èƒ½ã€å…¼å®¹æ€§å…¨é¢æµ‹è¯•
```

**âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹**
```
âœ… å¿…åšäº‹é¡¹ï¼š
- SSHä¸»æœºå¯†é’¥å¿…é¡»åˆ é™¤
- ç½‘ç»œæŒä¹…åŒ–è§„åˆ™å¿…é¡»æ¸…ç†
- æœºå™¨IDå¿…é¡»é‡ç½®
- cloud-initæœåŠ¡å¿…é¡»å¯ç”¨

âŒ ç¦æ­¢äº‹é¡¹ï¼š
- ä¸è¦è®¾ç½®å›ºå®šIPåœ°å€
- ä¸è¦é…ç½®å…·ä½“ä¸»æœºå
- ä¸è¦ä¿ç•™ä¸ªäººè´¦æˆ·ä¿¡æ¯
- ä¸è¦åŒ…å«ä¸šåŠ¡ç›¸å…³é…ç½®
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼



**ğŸ¯ é€‚ç”¨åœºæ™¯åˆ¤æ–­**
```
é€‚åˆåˆ¶ä½œäº‘é•œåƒçš„åœºæ™¯ï¼š
âœ… éœ€è¦æ‰¹é‡éƒ¨ç½²ç›¸åŒç¯å¢ƒ
âœ… è¦æ±‚éƒ¨ç½²é€Ÿåº¦å¿«
âœ… éœ€è¦æ ‡å‡†åŒ–é…ç½®
âœ… æœ‰ç‰ˆæœ¬ç®¡ç†éœ€æ±‚

ä¸é€‚åˆçš„åœºæ™¯ï¼š
âŒ ä¸€æ¬¡æ€§ä½¿ç”¨çš„ç¯å¢ƒ
âŒ é«˜åº¦å®šåˆ¶åŒ–çš„åº”ç”¨
âŒ é¢‘ç¹å˜æ›´çš„é…ç½®
âŒ åŒ…å«æ•æ„Ÿæ•°æ®çš„ç³»ç»Ÿ
```

**ğŸ”§ ä¼˜åŒ–å»ºè®®**
```
æ€§èƒ½ä¼˜åŒ–ï¼š
- ä½¿ç”¨SSDå­˜å‚¨åˆ¶ä½œé•œåƒ
- åˆç†è®¾ç½®è™šæ‹Ÿæœºç¡¬ä»¶è§„æ ¼
- é€‰æ‹©åˆé€‚çš„é•œåƒæ ¼å¼ï¼ˆQCOW2æ¨èï¼‰
- å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ

ç®¡ç†ä¼˜åŒ–ï¼š
- å»ºç«‹æ ‡å‡†çš„å‘½åè§„èŒƒ
- å®æ–½ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å»ºè®¾è‡ªåŠ¨åŒ–æ„å»ºæµç¨‹
- å®Œå–„æµ‹è¯•éªŒè¯æœºåˆ¶
```

**ğŸ§  æ ¸å¿ƒè®°å¿†æŠ€å·§**
```
åˆ¶ä½œå£è¯€ï¼š
è£…å¥½ç³»ç»Ÿé…cloud-initï¼Œæ¸…ç†å†å²é™¤ç—•è¿¹
å°è£…æµ‹è¯•éªŒåŠŸèƒ½ï¼Œç‰ˆæœ¬ç®¡ç†è¦è§„èŒƒ
è‡ªåŠ¨æ„å»ºææ•ˆç‡ï¼Œæ ‡å‡†æµç¨‹ä¿è´¨é‡

å…³é”®è®°å¿†ï¼š
- 4ä¸ªæ¸…ç†ï¼šæ—¥å¿—ã€SSHã€å†å²ã€ç½‘ç»œ
- 3ä¸ªæµ‹è¯•ï¼šåŠŸèƒ½ã€æ€§èƒ½ã€å…¼å®¹  
- 2ä¸ªåŸåˆ™ï¼šç²¾ç®€é€šç”¨ã€æ ‡å‡†ä¸€è‡´
- 1ä¸ªç›®æ ‡ï¼šå¿«é€Ÿæ ‡å‡†åŒ–éƒ¨ç½²
```

**ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“**
- **æ¨¡æ¿è®¾è®¡**ï¼šé€šç”¨æ€§å’Œå¯æ‰©å±•æ€§å¹¶é‡
- **ç‰ˆæœ¬ç®¡ç†**ï¼šè¯­ä¹‰åŒ–ç‰ˆæœ¬å· + å®Œæ•´å˜æ›´æ—¥å¿—
- **è‡ªåŠ¨åŒ–**ï¼šCI/CDé›†æˆï¼Œå‡å°‘äººå·¥å¹²é¢„
- **æµ‹è¯•éªŒè¯**ï¼šå¤šç»´åº¦æµ‹è¯•ï¼Œç¡®ä¿è´¨é‡
- **æ–‡æ¡£ç®¡ç†**ï¼šè¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œæ•…éšœæ’é™¤æŒ‡å—

> ğŸ¯ **æ ¸å¿ƒä»·å€¼**ï¼šäº‘é•œåƒæ¨¡æ¿åˆ¶ä½œæ˜¯äº‘è®¡ç®—åŸºç¡€è®¾æ–½æ ‡å‡†åŒ–çš„é‡è¦ç¯èŠ‚ï¼ŒæŒæ¡è¿™é¡¹æŠ€èƒ½å¯ä»¥å¤§å¹…æå‡è¿ç»´æ•ˆç‡å’Œç¯å¢ƒä¸€è‡´æ€§ï¼Œæ˜¯ç°ä»£ITåŸºç¡€è®¾æ–½ä¸å¯æˆ–ç¼ºçš„æŠ€æœ¯èƒ½åŠ›ã€‚