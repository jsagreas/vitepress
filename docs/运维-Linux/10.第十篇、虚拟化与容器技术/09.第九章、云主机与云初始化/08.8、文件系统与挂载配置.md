---
title: 8ã€æ–‡ä»¶ç³»ç»Ÿä¸æŒ‚è½½é…ç½®
---
## ğŸ“š ç›®å½•

1. [cloud-initæ–‡ä»¶ç³»ç»Ÿé…ç½®æ¦‚è¿°](#1-cloud-initæ–‡ä»¶ç³»ç»Ÿé…ç½®æ¦‚è¿°)
2. [write_filesæ–‡ä»¶å†™å…¥è¯¦è§£](#2-write_filesæ–‡ä»¶å†™å…¥è¯¦è§£)
3. [mountsæŒ‚è½½ç‚¹é…ç½®](#3-mountsæŒ‚è½½ç‚¹é…ç½®)
4. [disk_setupç£ç›˜åˆ†åŒºé…ç½®](#4-disk_setupç£ç›˜åˆ†åŒºé…ç½®)
5. [fs_setupæ–‡ä»¶ç³»ç»Ÿåˆ›å»º](#5-fs_setupæ–‡ä»¶ç³»ç»Ÿåˆ›å»º)
6. [ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿé…ç½®](#6-ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿé…ç½®)
7. [å®é™…åº”ç”¨æ¡ˆä¾‹](#7-å®é™…åº”ç”¨æ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ cloud-initæ–‡ä»¶ç³»ç»Ÿé…ç½®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯cloud-initæ–‡ä»¶ç³»ç»Ÿé…ç½®


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
cloud-initæ–‡ä»¶ç³»ç»Ÿé…ç½®ï¼šåœ¨äº‘ä¸»æœºåˆå§‹åŒ–æ—¶è‡ªåŠ¨é…ç½®å­˜å‚¨ç›¸å…³è®¾ç½®
ä¸»è¦åŠŸèƒ½ï¼šåˆ›å»ºæ–‡ä»¶ã€é…ç½®æŒ‚è½½ã€åˆ†åŒºç£ç›˜ã€æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ
åº”ç”¨åœºæ™¯ï¼šäº‘æœåŠ¡å™¨è‡ªåŠ¨åŒ–éƒ¨ç½²ã€å®¹å™¨ç¯å¢ƒé…ç½®ã€æ‰¹é‡æœåŠ¡å™¨ç®¡ç†
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ–‡ä»¶ç³»ç»Ÿé…ç½®**
```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
âŒ æ‰‹åŠ¨ç™»å½•æ¯å°æœåŠ¡å™¨é…ç½®
âŒ éœ€è¦ç¼–å†™å¤æ‚çš„éƒ¨ç½²è„šæœ¬
âŒ å®¹æ˜“å‡ºç°é…ç½®ä¸ä¸€è‡´
âŒ æ‰©å®¹æ—¶é‡å¤åŠ³åŠ¨

cloud-initçš„ä¼˜åŠ¿ï¼š
âœ… ç»Ÿä¸€é…ç½®æ¨¡æ¿
âœ… è‡ªåŠ¨åŒ–æ‰§è¡Œ
âœ… ç‰ˆæœ¬æ§åˆ¶ç®¡ç†
âœ… æ‰¹é‡éƒ¨ç½²ä¸€è‡´æ€§
```

### 1.2 é…ç½®æ‰§è¡Œæµç¨‹


**ğŸ”„ æ‰§è¡Œé¡ºåºå›¾**
```
äº‘ä¸»æœºå¯åŠ¨
    â†“
è¯»å–cloud-inité…ç½®
    â†“
disk_setup (ç£ç›˜åˆ†åŒº)
    â†“
fs_setup (æ–‡ä»¶ç³»ç»Ÿåˆ›å»º)
    â†“
mounts (æŒ‚è½½é…ç½®)
    â†“
write_files (æ–‡ä»¶å†™å…¥)
    â†“
ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
```

**âš ï¸ é‡è¦ç†è§£**
> è¿™ä¸ªæ‰§è¡Œé¡ºåºå¾ˆå…³é”®ï¼å¿…é¡»å…ˆåˆ†åŒºã€å†æ ¼å¼åŒ–ã€ç„¶åæŒ‚è½½ã€æœ€åå†™æ–‡ä»¶ã€‚
> å¦‚æœé¡ºåºæé”™ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–é…ç½®å¤±è´¥ã€‚

---

## 2. ğŸ“ write_filesæ–‡ä»¶å†™å…¥è¯¦è§£


### 2.1 åŸºæœ¬è¯­æ³•ä¸æ¦‚å¿µ


**ğŸ”¸ write_filesæ˜¯ä»€ä¹ˆ**
```
å®šä¹‰ï¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºå’Œå†™å…¥æ–‡ä»¶çš„åŠŸèƒ½
ç”¨é€”ï¼šé…ç½®æ–‡ä»¶åˆ›å»ºã€è„šæœ¬éƒ¨ç½²ã€è¯ä¹¦å®‰è£…ç­‰
ç‰¹ç‚¹ï¼šæ”¯æŒæ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€æƒé™è®¾ç½®ã€ç¼–ç è½¬æ¢
```

**åŸºæœ¬è¯­æ³•ç»“æ„**
```yaml
write_files:
  - path: /ç›®æ ‡æ–‡ä»¶è·¯å¾„
    content: æ–‡ä»¶å†…å®¹
    owner: æ–‡ä»¶æ‰€æœ‰è€…
    permissions: æ–‡ä»¶æƒé™
    encoding: ç¼–ç æ–¹å¼
```

### 2.2 è¯¦ç»†å‚æ•°è¯´æ˜


| å‚æ•°å | **ä½œç”¨è¯´æ˜** | **å¸¸ç”¨å€¼** | **ä½¿ç”¨ç¤ºä¾‹** |
|--------|-------------|-----------|-------------|
| `path` | `ç›®æ ‡æ–‡ä»¶çš„å®Œæ•´è·¯å¾„` | `ä»»æ„æœ‰æ•ˆè·¯å¾„` | `/etc/nginx/nginx.conf` |
| `content` | `æ–‡ä»¶çš„å…·ä½“å†…å®¹` | `æ–‡æœ¬æˆ–base64ç¼–ç ` | `server { listen 80; }` |
| `owner` | `æ–‡ä»¶æ‰€æœ‰è€…` | `ç”¨æˆ·å:ç»„å` | `root:root` æˆ– `nginx:nginx` |
| `permissions` | `æ–‡ä»¶æƒé™(å…«è¿›åˆ¶)` | `0644, 0755, 0600` | `0644`(æ™®é€šæ–‡ä»¶) `0755`(å¯æ‰§è¡Œ) |
| `encoding` | `å†…å®¹ç¼–ç æ–¹å¼` | `text/plain, base64, gzip+base64` | `base64`(äºŒè¿›åˆ¶æ–‡ä»¶) |

### 2.3 å®ç”¨é…ç½®ç¤ºä¾‹


**ğŸ“„ åˆ›å»ºé…ç½®æ–‡ä»¶**
```yaml
write_files:
  # åˆ›å»ºnginxé…ç½®æ–‡ä»¶
  - path: /etc/nginx/sites-available/mysite
    content: |
      server {
          listen 80;
          server_name example.com;
          root /var/www/html;
          index index.html;
      }
    owner: root:root
    permissions: '0644'
    
  # åˆ›å»ºå¯åŠ¨è„šæœ¬
  - path: /usr/local/bin/startup.sh
    content: |
      #!/bin/bash
      echo "æœåŠ¡å™¨å¯åŠ¨å®Œæˆ: $(date)" >> /var/log/startup.log
      systemctl start nginx
    owner: root:root
    permissions: '0755'
```

**ğŸ”’ å¤„ç†æ•æ„Ÿæ–‡ä»¶**
```yaml
write_files:
  # SSLè¯ä¹¦(base64ç¼–ç )
  - path: /etc/ssl/certs/server.crt
    content: LS0tLS1CRUdJTi... # base64ç¼–ç çš„è¯ä¹¦å†…å®¹
    encoding: base64
    owner: root:root
    permissions: '0600'
    
  # æ•°æ®åº“é…ç½®(åŒ…å«å¯†ç )
  - path: /etc/myapp/database.conf
    content: |
      host=localhost
      user=appuser
      password=secret123
      database=myapp
    owner: myapp:myapp
    permissions: '0600'  # åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
```

### 2.4 æƒé™æ¨¡å¼è¯¦è§£


**ğŸ” æƒé™æ•°å­—å«ä¹‰**
```
æƒé™æ ¼å¼ï¼š0ABC (å››ä½å…«è¿›åˆ¶æ•°)
A: ç‰¹æ®Šæƒé™(é€šå¸¸ä¸º0)
B: æ‰€æœ‰è€…æƒé™
C: ç»„æƒé™  
D: å…¶ä»–ç”¨æˆ·æƒé™

æ•°å­—å«ä¹‰ï¼š
4 = è¯»æƒé™ (r)
2 = å†™æƒé™ (w)  
1 = æ‰§è¡Œæƒé™ (x)

å¸¸ç”¨ç»„åˆï¼š
0644 = æ‰€æœ‰è€…è¯»å†™ï¼Œç»„å’Œå…¶ä»–ç”¨æˆ·åªè¯»
0755 = æ‰€æœ‰è€…è¯»å†™æ‰§è¡Œï¼Œç»„å’Œå…¶ä»–ç”¨æˆ·è¯»æ‰§è¡Œ
0600 = åªæœ‰æ‰€æœ‰è€…è¯»å†™ï¼Œå…¶ä»–äººæ— æƒé™
```

**ğŸ§ª åŠ¨æ‰‹éªŒè¯**
```bash
# æŸ¥çœ‹æ–‡ä»¶æƒé™
ls -l /etc/nginx/sites-available/mysite
# è¾“å‡ºç¤ºä¾‹ï¼š-rw-r--r-- 1 root root 123 Sep 18 15:30 mysite

# æƒé™è§£è¯»ï¼š
# -rw-r--r--
#  â†‘   â†‘   â†‘
# æ‰€æœ‰è€… ç»„ å…¶ä»–äºº
# rw-   r-- r--
# è¯»å†™  åªè¯» åªè¯»
```

---

## 3. ğŸ”— mountsæŒ‚è½½ç‚¹é…ç½®


### 3.1 æŒ‚è½½åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æŒ‚è½½**
```
æŒ‚è½½ï¼šå°†å­˜å‚¨è®¾å¤‡è¿æ¥åˆ°æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘çš„è¿‡ç¨‹
ç®€å•ç†è§£ï¼šæŠŠç¡¬ç›˜ã€Uç›˜ç­‰å­˜å‚¨è®¾å¤‡"æ’å…¥"åˆ°ç³»ç»Ÿçš„æŸä¸ªæ–‡ä»¶å¤¹
ç›®çš„ï¼šè®©ç³»ç»Ÿèƒ½å¤Ÿè®¿é—®å’Œä½¿ç”¨è¿™äº›å­˜å‚¨è®¾å¤‡ä¸Šçš„æ•°æ®
```

**ç”Ÿæ´»ç±»æ¯”**
> ğŸ  **æˆ¿å­ç±»æ¯”**ï¼š
> - æ–‡ä»¶ç³»ç»Ÿåƒæˆ¿å­çš„æˆ¿é—´ç»“æ„
> - æŒ‚è½½ç‚¹åƒæˆ¿é—´çš„é—¨
> - å­˜å‚¨è®¾å¤‡åƒå®¶å…·
> - æŒ‚è½½å°±æ˜¯æŠŠå®¶å…·æ”¾åˆ°æŒ‡å®šæˆ¿é—´

### 3.2 mountsé…ç½®è¯­æ³•


**åŸºæœ¬æ ¼å¼**
```yaml
mounts:
  - [è®¾å¤‡, æŒ‚è½½ç‚¹, æ–‡ä»¶ç³»ç»Ÿç±»å‹, é€‰é¡¹, dump, pass]
```

**å‚æ•°è¯¦è§£**
```yaml
mounts:
  - ["/dev/sdb1", "/data", "ext4", "defaults", 0, 2]
#    â†‘          â†‘       â†‘       â†‘          â†‘  â†‘
#    è®¾å¤‡å     æŒ‚è½½ç‚¹  æ–‡ä»¶ç³»ç»Ÿ æŒ‚è½½é€‰é¡¹    å¤‡ä»½ æ£€æŸ¥é¡ºåº
```

| ä½ç½® | **å‚æ•°å** | **ä½œç”¨è¯´æ˜** | **å¸¸ç”¨å€¼** |
|------|-----------|-------------|-----------|
| 1 | `è®¾å¤‡` | `è¦æŒ‚è½½çš„å­˜å‚¨è®¾å¤‡` | `/dev/sdb1`, `UUID=xxx`, `LABEL=data` |
| 2 | `æŒ‚è½½ç‚¹` | `æŒ‚è½½åˆ°çš„ç›®å½•è·¯å¾„` | `/data`, `/backup`, `/home` |
| 3 | `æ–‡ä»¶ç³»ç»Ÿ` | `å­˜å‚¨è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹` | `ext4`, `xfs`, `ntfs`, `nfs` |
| 4 | `é€‰é¡¹` | `æŒ‚è½½æ—¶çš„ç‰¹æ®Šè®¾ç½®` | `defaults`, `ro`, `rw`, `noexec` |
| 5 | `dump` | `æ˜¯å¦å¤‡ä»½(0=å¦,1=æ˜¯)` | `0`, `1` |
| 6 | `pass` | `å¯åŠ¨æ—¶æ£€æŸ¥é¡ºåº` | `0`(ä¸æ£€æŸ¥), `1`(æ ¹æ–‡ä»¶ç³»ç»Ÿ), `2`(å…¶ä»–) |

### 3.3 å®ç”¨æŒ‚è½½é…ç½®


**ğŸ“¦ åŸºç¡€æŒ‚è½½ç¤ºä¾‹**
```yaml
mounts:
  # æŒ‚è½½æ•°æ®ç›˜
  - ["/dev/sdb1", "/data", "ext4", "defaults", 0, 2]
  
  # æŒ‚è½½å¤‡ä»½ç›˜(åªè¯»)
  - ["/dev/sdc1", "/backup", "ext4", "ro,noexec", 0, 2]
  
  # æŒ‚è½½NFSç½‘ç»œå­˜å‚¨
  - ["192.168.1.100:/shared", "/mnt/nfs", "nfs", "defaults", 0, 0]
```

**ğŸ”§ é«˜çº§æŒ‚è½½é€‰é¡¹**
```yaml
mounts:
  # æ€§èƒ½ä¼˜åŒ–æŒ‚è½½
  - ["/dev/sdb1", "/database", "ext4", "defaults,noatime,nodiratime", 0, 2]
  
  # å®‰å…¨æŒ‚è½½(ç¦æ­¢æ‰§è¡Œ)
  - ["/dev/sdc1", "/uploads", "ext4", "defaults,noexec,nosuid,nodev", 0, 2]
  
  # ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ
  - ["tmpfs", "/tmp", "tmpfs", "defaults,size=1G", 0, 0]
```

**æŒ‚è½½é€‰é¡¹è¯¦è§£**
```
å¸¸ç”¨é€‰é¡¹å«ä¹‰ï¼š
defaults    = ä½¿ç”¨é»˜è®¤é€‰é¡¹(rw,suid,dev,exec,auto,nouser,async)
ro          = åªè¯»æŒ‚è½½
rw          = è¯»å†™æŒ‚è½½  
noexec      = ç¦æ­¢æ‰§è¡Œæ–‡ä»¶
nosuid      = å¿½ç•¥SUIDä½
nodev       = ä¸å…è®¸è®¾å¤‡æ–‡ä»¶
noatime     = ä¸æ›´æ–°è®¿é—®æ—¶é—´(æå‡æ€§èƒ½)
size=1G     = é™åˆ¶tmpfså¤§å°ä¸º1GB
```

### 3.4 å¸¸è§é—®é¢˜è§£å†³


**âŒ å¸¸è§é”™è¯¯**
```
é”™è¯¯1ï¼šè®¾å¤‡ä¸å­˜åœ¨
- ç°è±¡ï¼šmount: /dev/sdb1 does not exist
- è§£å†³ï¼šæ£€æŸ¥è®¾å¤‡åç§°ï¼Œä½¿ç”¨ lsblk æŸ¥çœ‹å¯ç”¨è®¾å¤‡

é”™è¯¯2ï¼šæŒ‚è½½ç‚¹ä¸å­˜åœ¨  
- ç°è±¡ï¼šmount: /data: mount point does not exist
- è§£å†³ï¼šå…ˆåˆ›å»ºç›®å½• mkdir -p /data

é”™è¯¯3ï¼šæ–‡ä»¶ç³»ç»Ÿç±»å‹é”™è¯¯
- ç°è±¡ï¼šmount: wrong fs type, bad option
- è§£å†³ï¼šä½¿ç”¨ blkid æ£€æŸ¥å®é™…æ–‡ä»¶ç³»ç»Ÿç±»å‹
```

**ğŸ” è¯Šæ–­å‘½ä»¤**
```bash
# æŸ¥çœ‹æ‰€æœ‰å­˜å‚¨è®¾å¤‡
lsblk

# æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯
blkid /dev/sdb1

# æŸ¥çœ‹å½“å‰æŒ‚è½½çŠ¶æ€
df -h
mount | grep /data
```

---

## 4. ğŸ’¾ disk_setupç£ç›˜åˆ†åŒºé…ç½®


### 4.1 ç£ç›˜åˆ†åŒºåŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç£ç›˜åˆ†åŒº**
```
ç£ç›˜åˆ†åŒºï¼šå°†ä¸€ä¸ªç‰©ç†ç¡¬ç›˜åˆ’åˆ†æˆå¤šä¸ªé€»è¾‘åŒºåŸŸ
ä½œç”¨ï¼šéš”ç¦»æ•°æ®ã€ä¼˜åŒ–æ€§èƒ½ã€ä¾¿äºç®¡ç†
åˆ†åŒºç±»å‹ï¼šä¸»åˆ†åŒºã€æ‰©å±•åˆ†åŒºã€é€»è¾‘åˆ†åŒº
```

**ğŸ“Š åˆ†åŒºè§„åˆ’ç¤ºä¾‹**
```
ç¡¬ç›˜ /dev/sdb (100GB)
â”œâ”€â”€ /dev/sdb1 (20GB) â†’ ç³»ç»Ÿæ•°æ®
â”œâ”€â”€ /dev/sdb2 (50GB) â†’ åº”ç”¨æ•°æ®  
â””â”€â”€ /dev/sdb3 (30GB) â†’ å¤‡ä»½æ•°æ®
```

### 4.2 disk_setupé…ç½®è¯­æ³•


**åŸºæœ¬ç»“æ„**
```yaml
disk_setup:
  è®¾å¤‡å:
    table_type: åˆ†åŒºè¡¨ç±»å‹
    layout: åˆ†åŒºå¸ƒå±€
    overwrite: æ˜¯å¦è¦†ç›–ç°æœ‰åˆ†åŒº
```

**è¯¦ç»†é…ç½®ç¤ºä¾‹**
```yaml
disk_setup:
  /dev/sdb:
    table_type: gpt        # åˆ†åŒºè¡¨ç±»å‹(gptæˆ–msdos)
    layout: auto           # è‡ªåŠ¨åˆ†åŒºå¸ƒå±€
    overwrite: false       # ä¸è¦†ç›–ç°æœ‰åˆ†åŒº
    
  /dev/sdc:
    table_type: gpt
    layout:
      - [20, 83]          # 20%ç©ºé—´ï¼ŒLinuxæ–‡ä»¶ç³»ç»Ÿ
      - [30, 83]          # 30%ç©ºé—´ï¼ŒLinuxæ–‡ä»¶ç³»ç»Ÿ  
      - [50, 83]          # 50%ç©ºé—´ï¼ŒLinuxæ–‡ä»¶ç³»ç»Ÿ
    overwrite: true       # è¦†ç›–ç°æœ‰åˆ†åŒº(å±é™©!)
```

### 4.3 åˆ†åŒºå¸ƒå±€è¯¦è§£


**ğŸ“‹ layoutå‚æ•°è¯´æ˜**
```
layoutæ ¼å¼ï¼š[å¤§å°, åˆ†åŒºç±»å‹]

å¤§å°è¡¨ç¤ºï¼š
- æ•°å­—ï¼šç™¾åˆ†æ¯” (å¦‚ 50 è¡¨ç¤º50%)
- autoï¼šè‡ªåŠ¨åˆ†é…å‰©ä½™ç©ºé—´
- å…·ä½“æ•°å€¼ï¼šå¦‚ "10GB", "512MB"

åˆ†åŒºç±»å‹ä»£ç ï¼š
83 = Linuxæ–‡ä»¶ç³»ç»Ÿ
82 = Linux swapäº¤æ¢åˆ†åŒº
7  = NTFSæ–‡ä»¶ç³»ç»Ÿ
```

**ğŸ¯ å®ç”¨åˆ†åŒºæ–¹æ¡ˆ**
```yaml
disk_setup:
  # æ•°æ®åº“æœåŠ¡å™¨åˆ†åŒº
  /dev/sdb:
    table_type: gpt
    layout:
      - [10, 82]          # 10% äº¤æ¢åˆ†åŒº
      - [60, 83]          # 60% æ•°æ®åº“æ•°æ®
      - [30, 83]          # 30% æ—¥å¿—å­˜å‚¨
    overwrite: false
    
  # WebæœåŠ¡å™¨åˆ†åŒº  
  /dev/sdc:
    table_type: gpt
    layout:
      - [40, 83]          # 40% ç½‘ç«™æ–‡ä»¶
      - [40, 83]          # 40% ä¸Šä¼ æ–‡ä»¶
      - [20, 83]          # 20% ç¼“å­˜ç›®å½•
```

### 4.4 åˆ†åŒºè¡¨ç±»å‹é€‰æ‹©


| åˆ†åŒºè¡¨ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|-----------|-------------|---------|---------|
| **GPT** | `ç°ä»£ç³»ç»Ÿï¼Œå¤§ç¡¬ç›˜` | `æ”¯æŒ>2TBç¡¬ç›˜ï¼Œåˆ†åŒºæ•°é‡å¤š` | `è€ç³»ç»Ÿå¯èƒ½ä¸æ”¯æŒ` |
| **MBR/msdos** | `è€ç³»ç»Ÿï¼Œå°ç¡¬ç›˜` | `å…¼å®¹æ€§å¥½` | `æœ€å¤§2TBï¼Œæœ€å¤š4ä¸ªä¸»åˆ†åŒº` |

**ğŸ”¸ é€‰æ‹©å»ºè®®**
```
ä½¿ç”¨GPTçš„æƒ…å†µï¼š
âœ… ç¡¬ç›˜å¤§äº2TB
âœ… éœ€è¦è¶…è¿‡4ä¸ªåˆ†åŒº
âœ… ç°ä»£Linuxç³»ç»Ÿ
âœ… UEFIå¯åŠ¨æ–¹å¼

ä½¿ç”¨MBRçš„æƒ…å†µï¼š
âœ… è€æ—§ç³»ç»Ÿå…¼å®¹æ€§è¦æ±‚
âœ… ä¼ ç»ŸBIOSå¯åŠ¨
âœ… ç¡¬ç›˜å°äº2TBä¸”åˆ†åŒºå°‘äº4ä¸ª
```

---

## 5. ğŸ—‚ï¸ fs_setupæ–‡ä»¶ç³»ç»Ÿåˆ›å»º


### 5.1 æ–‡ä»¶ç³»ç»ŸåŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿ**
```
æ–‡ä»¶ç³»ç»Ÿï¼šç®¡ç†å­˜å‚¨è®¾å¤‡ä¸Šæ•°æ®ç»„ç»‡æ–¹å¼çš„ç³»ç»Ÿ
ä½œç”¨ï¼šå†³å®šå¦‚ä½•å­˜å‚¨æ–‡ä»¶ã€ç›®å½•ç»“æ„ã€æƒé™ç®¡ç†
å¸¸è§ç±»å‹ï¼šext4(Linux)ã€xfs(ä¼ä¸šçº§)ã€ntfs(Windows)ã€btrfs(æ–°ä¸€ä»£)
```

**ğŸ—ï¸ æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©æŒ‡å—**
```
ext4ï¼š
âœ… ç¨³å®šå¯é ï¼Œå¹¿æ³›æ”¯æŒ
âœ… é€‚åˆä¸€èˆ¬Linuxåº”ç”¨
âŒ å¤§æ–‡ä»¶æ€§èƒ½ç›¸å¯¹è¾ƒå¼±

xfsï¼š  
âœ… é«˜æ€§èƒ½ï¼Œé€‚åˆå¤§æ–‡ä»¶
âœ… ä¼ä¸šçº§ç‰¹æ€§ä¸°å¯Œ
âŒ ä¿®å¤å·¥å…·ç›¸å¯¹å¤æ‚

btrfsï¼š
âœ… å¿«ç…§ã€å‹ç¼©ç­‰é«˜çº§ç‰¹æ€§
âœ… å†™æ—¶å¤åˆ¶æŠ€æœ¯
âŒ ç›¸å¯¹è¾ƒæ–°ï¼Œç¨³å®šæ€§å¾…è€ƒéªŒ
```

### 5.2 fs_setupé…ç½®è¯­æ³•


**åŸºæœ¬ç»“æ„**
```yaml
fs_setup:
  - label: åˆ†åŒºæ ‡ç­¾
    filesystem: æ–‡ä»¶ç³»ç»Ÿç±»å‹
    device: ç›®æ ‡è®¾å¤‡
    partition: åˆ†åŒºå·
    overwrite: æ˜¯å¦è¦†ç›–
    cmd: è‡ªå®šä¹‰æ ¼å¼åŒ–å‘½ä»¤
```

**è¯¦ç»†é…ç½®ç¤ºä¾‹**
```yaml
fs_setup:
  # åˆ›å»ºext4æ–‡ä»¶ç³»ç»Ÿ
  - label: data
    filesystem: ext4
    device: /dev/sdb
    partition: 1
    overwrite: false
    
  # åˆ›å»ºxfsæ–‡ä»¶ç³»ç»Ÿ(é«˜æ€§èƒ½)
  - label: database  
    filesystem: xfs
    device: /dev/sdc
    partition: 1
    overwrite: false
    
  # äº¤æ¢åˆ†åŒº
  - label: swap
    filesystem: swap
    device: /dev/sdb
    partition: 2
```

### 5.3 é«˜çº§æ–‡ä»¶ç³»ç»Ÿé…ç½®


**ğŸš€ æ€§èƒ½ä¼˜åŒ–é…ç½®**
```yaml
fs_setup:
  # æ•°æ®åº“ä¼˜åŒ–çš„xfs
  - label: dbdata
    filesystem: xfs
    device: /dev/sdb1
    cmd: 'mkfs.xfs -f -i size=512 -d agcount=8'
    # -i size=512: ä¼˜åŒ–inodeå¤§å°
    # -d agcount=8: è®¾ç½®åˆ†é…ç»„æ•°é‡
    
  # å¤§æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–çš„ext4
  - label: bigfiles
    filesystem: ext4  
    device: /dev/sdc1
    cmd: 'mkfs.ext4 -F -T largefile4 -E lazy_itable_init=0'
    # -T largefile4: å¤§æ–‡ä»¶ä¼˜åŒ–
    # -E lazy_itable_init=0: ç«‹å³åˆå§‹åŒ–
```

**ğŸ“Š æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§å¯¹æ¯”**

| ç‰¹æ€§ | **ext4** | **xfs** | **btrfs** |
|------|---------|---------|-----------|
| **æœ€å¤§æ–‡ä»¶å¤§å°** | `16TB` | `8EB` | `16EB` |
| **æœ€å¤§æ–‡ä»¶ç³»ç»Ÿ** | `1EB` | `8EB` | `16EB` |
| **å¿«ç…§æ”¯æŒ** | `âŒ` | `âŒ` | `âœ…` |
| **åœ¨çº¿è°ƒæ•´å¤§å°** | `âœ…æ‰©å±•` | `âœ…æ‰©å±•` | `âœ…åŒå‘` |
| **æ•°æ®å‹ç¼©** | `âŒ` | `âŒ` | `âœ…` |
| **é€‚ç”¨åœºæ™¯** | `é€šç”¨` | `é«˜æ€§èƒ½` | `é«˜çº§ç‰¹æ€§` |

### 5.4 æ–‡ä»¶ç³»ç»Ÿæ ‡ç­¾ç®¡ç†


**ğŸ”– æ ‡ç­¾çš„ä½œç”¨**
```
æ–‡ä»¶ç³»ç»Ÿæ ‡ç­¾ï¼šç»™åˆ†åŒºèµ·ä¸ªæ˜“è®°çš„åå­—
ä¼˜åŠ¿ï¼š
âœ… è®¾å¤‡åå˜åŒ–æ—¶é…ç½®ä¸å—å½±å“
âœ… æ›´æ˜“ç†è§£å’Œç®¡ç†
âœ… è‡ªåŠ¨æŒ‚è½½æ›´å¯é 

ä½¿ç”¨æ–¹å¼ï¼š
æŒ‚è½½æ—¶ç”¨ LABEL=data ä»£æ›¿ /dev/sdb1
```

**è®¾ç½®å’Œä½¿ç”¨æ ‡ç­¾**
```yaml
# fs_setupä¸­è®¾ç½®æ ‡ç­¾
fs_setup:
  - label: webdata
    filesystem: ext4
    device: /dev/sdb1
    
# mountsä¸­ä½¿ç”¨æ ‡ç­¾  
mounts:
  - ["LABEL=webdata", "/var/www", "ext4", "defaults", 0, 2]
```

**ğŸ” æ ‡ç­¾ç®¡ç†å‘½ä»¤**
```bash
# æŸ¥çœ‹æ‰€æœ‰åˆ†åŒºæ ‡ç­¾
lsblk -f

# ä¸ºå·²æœ‰åˆ†åŒºè®¾ç½®æ ‡ç­¾
sudo e2label /dev/sdb1 mydata     # ext2/3/4
sudo xfs_admin -L mydata /dev/sdb1 # xfs

# é€šè¿‡æ ‡ç­¾æŸ¥æ‰¾è®¾å¤‡
findfs LABEL=mydata
```

---

## 6. ğŸ’¨ ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿé…ç½®


### 6.1 ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿæ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ(tmpfs)**
```
tmpfsï¼šåŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿ
ç‰¹ç‚¹ï¼šè¯»å†™é€Ÿåº¦æå¿«ï¼Œé‡å¯åæ•°æ®æ¶ˆå¤±
ç”¨é€”ï¼šä¸´æ—¶æ–‡ä»¶ã€ç¼“å­˜ã€é«˜é¢‘è¯»å†™æ•°æ®
åŸç†ï¼šç›´æ¥ä½¿ç”¨å†…å­˜å’Œäº¤æ¢åˆ†åŒºä½œä¸ºå­˜å‚¨
```

**âš¡ æ€§èƒ½å¯¹æ¯”**
```
å­˜å‚¨ç±»å‹æ€§èƒ½æ’åº(ä»å¿«åˆ°æ…¢)ï¼š
1. tmpfs (å†…å­˜)     â†’ å‡ GB/s
2. NVMe SSD        â†’ å‡ ç™¾MB/s  
3. SATA SSD        â†’ å‡ åMB/s
4. æœºæ¢°ç¡¬ç›˜         â†’ å‡ åMB/s
```

### 6.2 tmpfsé…ç½®æ–¹æ³•


**åŸºæœ¬tmpfsæŒ‚è½½**
```yaml
mounts:
  # åŸºç¡€tmpfsé…ç½®
  - ["tmpfs", "/tmp", "tmpfs", "defaults,size=1G", 0, 0]
  
  # åº”ç”¨ç¼“å­˜ç›®å½•
  - ["tmpfs", "/var/cache/app", "tmpfs", "defaults,size=512M,uid=1000", 0, 0]
  
  # æ—¥å¿—ç¼“å†²åŒº
  - ["tmpfs", "/var/log/buffer", "tmpfs", "defaults,size=256M,mode=755", 0, 0]
```

**ğŸ”§ tmpfsé€‰é¡¹è¯¦è§£**
```
size=1G        : é™åˆ¶æœ€å¤§ä½¿ç”¨1GBå†…å­˜
uid=1000       : è®¾ç½®æ‰€æœ‰è€…ç”¨æˆ·ID
gid=1000       : è®¾ç½®æ‰€æœ‰è€…ç»„ID  
mode=755       : è®¾ç½®ç›®å½•æƒé™
nr_inodes=1024 : é™åˆ¶æœ€å¤§æ–‡ä»¶æ•°é‡
```

### 6.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ“Š æ•°æ®åº“ç¼“å­˜ä¼˜åŒ–**
```yaml
mounts:
  # MySQLä¸´æ—¶è¡¨ç©ºé—´
  - ["tmpfs", "/var/lib/mysql/tmp", "tmpfs", "defaults,size=2G,uid=mysql,gid=mysql", 0, 0]
  
  # RedisæŒä¹…åŒ–ç¼“å†²
  - ["tmpfs", "/var/lib/redis/tmp", "tmpfs", "defaults,size=1G,uid=redis,gid=redis", 0, 0]
```

**ğŸŒ WebæœåŠ¡ä¼˜åŒ–**
```yaml
mounts:
  # Nginxç¼“å­˜ç›®å½•
  - ["tmpfs", "/var/cache/nginx", "tmpfs", "defaults,size=512M,uid=nginx", 0, 0]
  
  # PHPä¼šè¯å­˜å‚¨
  - ["tmpfs", "/var/lib/php/sessions", "tmpfs", "defaults,size=256M,mode=733", 0, 0]
```

### 6.4 tmpfsä½¿ç”¨æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦æé†’**
```
ä½¿ç”¨tmpfsæ³¨æ„äº‹é¡¹ï¼š

æ•°æ®æŒä¹…æ€§ï¼š
âŒ é‡å¯åæ•°æ®å…¨éƒ¨ä¸¢å¤±
âœ… åªç”¨äºå¯é‡å»ºçš„ä¸´æ—¶æ•°æ®

å†…å­˜ä½¿ç”¨ï¼š
âŒ å¤§é‡ä½¿ç”¨ä¼šæŒ¤å ç³»ç»Ÿå†…å­˜
âœ… åˆç†è®¾ç½®sizeé™åˆ¶

å¤‡ä»½ç­–ç•¥ï¼š
âŒ é‡è¦æ•°æ®ä¸è¦æ”¾tmpfs
âœ… å®šæœŸåŒæ­¥åˆ°æŒä¹…å­˜å‚¨
```

**ğŸ§ª åŠ¨æ‰‹éªŒè¯tmpfsæ€§èƒ½**
```bash
# æµ‹è¯•tmpfså†™æ€§èƒ½
sudo mount -t tmpfs -o size=1G tmpfs /mnt/test
dd if=/dev/zero of=/mnt/test/testfile bs=1M count=100

# æµ‹è¯•æ™®é€šç£ç›˜å†™æ€§èƒ½  
dd if=/dev/zero of=/tmp/testfile bs=1M count=100

# å¯¹æ¯”ç»“æœï¼Œtmpfsé€šå¸¸å¿«10-100å€
```

---

## 7. ğŸš€ å®é™…åº”ç”¨æ¡ˆä¾‹


### 7.1 WebæœåŠ¡å™¨å®Œæ•´é…ç½®


**ğŸ“‹ éœ€æ±‚åˆ†æ**
```
åœºæ™¯ï¼šéƒ¨ç½²ä¸€å°WebæœåŠ¡å™¨
è¦æ±‚ï¼š
- ç³»ç»Ÿç›˜ï¼šè¿è¡Œæ“ä½œç³»ç»Ÿ
- æ•°æ®ç›˜ï¼šå­˜å‚¨ç½‘ç«™æ–‡ä»¶  
- æ—¥å¿—ç›˜ï¼šå­˜å‚¨è®¿é—®æ—¥å¿—
- ç¼“å­˜ï¼šé«˜é€Ÿä¸´æ—¶å­˜å‚¨
```

**å®Œæ•´cloud-inité…ç½®**
```yaml
# WebæœåŠ¡å™¨å­˜å‚¨é…ç½®
disk_setup:
  /dev/sdb:  # æ•°æ®ç›˜
    table_type: gpt
    layout:
      - [70, 83]  # 70% ç½‘ç«™æ–‡ä»¶
      - [30, 83]  # 30% ä¸Šä¼ æ–‡ä»¶
    overwrite: false
    
  /dev/sdc:  # æ—¥å¿—ç›˜
    table_type: gpt  
    layout: auto
    overwrite: false

fs_setup:
  # ç½‘ç«™æ–‡ä»¶åˆ†åŒº
  - label: webroot
    filesystem: ext4
    device: /dev/sdb
    partition: 1
    
  # ä¸Šä¼ æ–‡ä»¶åˆ†åŒº  
  - label: uploads
    filesystem: ext4
    device: /dev/sdb
    partition: 2
    
  # æ—¥å¿—åˆ†åŒº
  - label: logs
    filesystem: xfs
    device: /dev/sdc
    partition: 1

mounts:
  # æŒ‚è½½ç½‘ç«™æ ¹ç›®å½•
  - ["LABEL=webroot", "/var/www/html", "ext4", "defaults,noatime", 0, 2]
  
  # æŒ‚è½½ä¸Šä¼ ç›®å½•(å®‰å…¨æŒ‚è½½)
  - ["LABEL=uploads", "/var/www/uploads", "ext4", "defaults,noexec,nosuid", 0, 2]
  
  # æŒ‚è½½æ—¥å¿—ç›®å½•
  - ["LABEL=logs", "/var/log/nginx", "xfs", "defaults", 0, 2]
  
  # Nginxç¼“å­˜(tmpfs)
  - ["tmpfs", "/var/cache/nginx", "tmpfs", "defaults,size=512M,uid=nginx", 0, 0]

write_files:
  # Nginxé…ç½®æ–‡ä»¶
  - path: /etc/nginx/sites-available/default
    content: |
      server {
          listen 80;
          root /var/www/html;
          index index.html index.php;
          
          # ä¸Šä¼ æ–‡ä»¶ç›®å½•
          location /uploads/ {
              alias /var/www/uploads/;
              expires 30d;
          }
          
          # ç¼“å­˜é™æ€æ–‡ä»¶
          location ~* \.(css|js|jpg|png)$ {
              expires 1y;
              add_header Cache-Control "public, immutable";
          }
      }
    owner: root:root
    permissions: '0644'
    
  # å¯åŠ¨è„šæœ¬
  - path: /usr/local/bin/web-setup.sh
    content: |
      #!/bin/bash
      # åˆ›å»ºå¿…è¦ç›®å½•
      mkdir -p /var/www/html /var/www/uploads
      chown -R www-data:www-data /var/www
      
      # å¯åŠ¨æœåŠ¡
      systemctl enable nginx
      systemctl start nginx
      
      echo "WebæœåŠ¡å™¨é…ç½®å®Œæˆ: $(date)" >> /var/log/setup.log
    owner: root:root
    permissions: '0755'
```

### 7.2 æ•°æ®åº“æœåŠ¡å™¨é…ç½®


**ğŸ—„ï¸ MySQLæœåŠ¡å™¨å­˜å‚¨é…ç½®**
```yaml
disk_setup:
  /dev/sdb:  # æ•°æ®åº“ä¸“ç”¨ç›˜
    table_type: gpt
    layout:
      - [5, 82]   # 5% äº¤æ¢åˆ†åŒº
      - [70, 83]  # 70% æ•°æ®æ–‡ä»¶
      - [25, 83]  # 25% æ—¥å¿—æ–‡ä»¶

fs_setup:
  - label: mysql-swap
    filesystem: swap
    device: /dev/sdb
    partition: 1
    
  - label: mysql-data
    filesystem: xfs  # é«˜æ€§èƒ½æ–‡ä»¶ç³»ç»Ÿ
    device: /dev/sdb
    partition: 2
    cmd: 'mkfs.xfs -f -i size=512 -d agcount=4'
    
  - label: mysql-logs
    filesystem: xfs
    device: /dev/sdb
    partition: 3

mounts:
  # å¯ç”¨äº¤æ¢åˆ†åŒº
  - ["LABEL=mysql-swap", "none", "swap", "sw", 0, 0]
  
  # æ•°æ®ç›®å½•(æ€§èƒ½ä¼˜åŒ–)
  - ["LABEL=mysql-data", "/var/lib/mysql", "xfs", "defaults,noatime,nodiratime", 0, 2]
  
  # æ—¥å¿—ç›®å½•
  - ["LABEL=mysql-logs", "/var/log/mysql", "xfs", "defaults", 0, 2]
  
  # ä¸´æ—¶è¡¨ç©ºé—´(å†…å­˜)
  - ["tmpfs", "/var/lib/mysql/tmp", "tmpfs", "defaults,size=1G,uid=mysql,gid=mysql", 0, 0]

write_files:
  # MySQLé…ç½®ä¼˜åŒ–
  - path: /etc/mysql/mysql.conf.d/performance.cnf
    content: |
      [mysqld]
      # æ•°æ®ç›®å½•
      datadir = /var/lib/mysql
      tmpdir = /var/lib/mysql/tmp
      
      # æ€§èƒ½ä¼˜åŒ–
      innodb_buffer_pool_size = 1G
      innodb_log_file_size = 256M
      innodb_flush_log_at_trx_commit = 2
      
      # æ—¥å¿—é…ç½®
      log-error = /var/log/mysql/error.log
      slow_query_log = 1
      slow_query_log_file = /var/log/mysql/slow.log
    owner: root:root
    permissions: '0644'
```

### 7.3 å¼€å‘ç¯å¢ƒé…ç½®


**ğŸ’» å¼€å‘è€…å·¥ä½œç«™é…ç½®**
```yaml
# å¼€å‘ç¯å¢ƒå­˜å‚¨é…ç½®
mounts:
  # é¡¹ç›®ä»£ç ç›®å½•(é«˜é€Ÿè®¿é—®)
  - ["tmpfs", "/dev/shm/projects", "tmpfs", "defaults,size=2G,uid=1000,gid=1000", 0, 0]
  
  # Dockeré•œåƒç¼“å­˜
  - ["tmpfs", "/var/lib/docker/tmp", "tmpfs", "defaults,size=4G", 0, 0]

write_files:
  # å¼€å‘ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬
  - path: /home/developer/setup-env.sh
    content: |
      #!/bin/bash
      # åˆ›å»ºé¡¹ç›®ç›®å½•è½¯é“¾æ¥
      ln -sf /dev/shm/projects ~/projects
      
      # è®¾ç½®Gité…ç½®
      git config --global user.name "Developer"
      git config --global user.email "dev@example.com"
      
      # å®‰è£…å¼€å‘å·¥å…·
      curl -fsSL https://get.docker.com | sh
      sudo usermod -aG docker developer
      
      echo "å¼€å‘ç¯å¢ƒå‡†å¤‡å®Œæˆï¼"
    owner: developer:developer
    permissions: '0755'
    
  # VSCodeè®¾ç½®
  - path: /home/developer/.vscode/settings.json
    content: |
      {
          "workbench.startupEditor": "newUntitledFile",
          "editor.fontSize": 14,
          "terminal.integrated.fontSize": 12,
          "files.autoSave": "afterDelay"
      }
    owner: developer:developer
    permissions: '0644'
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å››å¤§æ ¸å¿ƒåŠŸèƒ½**
```
write_filesï¼šæ–‡ä»¶åˆ›å»ºå’Œå†…å®¹å†™å…¥
mountsï¼šå­˜å‚¨è®¾å¤‡æŒ‚è½½é…ç½®  
disk_setupï¼šç£ç›˜åˆ†åŒºè§„åˆ’
fs_setupï¼šæ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–
```

**ğŸ”¸ æ‰§è¡Œé¡ºåºç†è§£**
```
æ­£ç¡®é¡ºåºï¼šåˆ†åŒº â†’ æ ¼å¼åŒ– â†’ æŒ‚è½½ â†’ å†™æ–‡ä»¶
å…³é”®è¦ç‚¹ï¼šå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸èƒ½é¢ å€’
å®é™…æ„ä¹‰ï¼šå°±åƒå…ˆä¿®æˆ¿å­å†è£…ä¿®å†å…¥ä½
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ–‡ä»¶æƒé™ç®¡ç†**
```
åŸºæœ¬åŸåˆ™ï¼šæœ€å°æƒé™åŸåˆ™
å¸¸ç”¨æƒé™ï¼š
- 0644ï¼šæ™®é€šé…ç½®æ–‡ä»¶
- 0755ï¼šå¯æ‰§è¡Œè„šæœ¬  
- 0600ï¼šæ•æ„Ÿæ–‡ä»¶(å¯†ç ã€è¯ä¹¦)

æƒé™æ£€æŸ¥ï¼š
ls -l æŸ¥çœ‹æ–‡ä»¶æƒé™
chmod ä¿®æ”¹æƒé™
chown ä¿®æ”¹æ‰€æœ‰è€…
```

**ğŸ”¹ æŒ‚è½½é€‰é¡¹é€‰æ‹©**
```
æ€§èƒ½ä¼˜åŒ–ï¼šnoatime, nodiratime
å®‰å…¨åŠ å›ºï¼šnoexec, nosuid, nodev  
ç‰¹æ®Šéœ€æ±‚ï¼šro(åªè¯»), sizeé™åˆ¶(tmpfs)

é€‰æ‹©åŸåˆ™ï¼š
- æ•°æ®åº“ç›®å½•ï¼šæ€§èƒ½ä¼˜å…ˆ
- ä¸Šä¼ ç›®å½•ï¼šå®‰å…¨ä¼˜å…ˆ
- ç¼“å­˜ç›®å½•ï¼šé€Ÿåº¦ä¼˜å…ˆ
```

**ğŸ”¹ æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©ç­–ç•¥**
```
ext4ï¼šé€šç”¨é€‰æ‹©ï¼Œç¨³å®šå¯é 
xfsï¼šé«˜æ€§èƒ½éœ€æ±‚ï¼Œå¤§æ–‡ä»¶å¤„ç†
tmpfsï¼šä¸´æ—¶æ•°æ®ï¼Œæé€Ÿè®¿é—®
swapï¼šäº¤æ¢åˆ†åŒºï¼Œå†…å­˜æ‰©å±•

é€‰æ‹©ä¾æ®ï¼š
- æ•°æ®é‡è¦æ€§
- æ€§èƒ½è¦æ±‚  
- æ–‡ä»¶å¤§å°ç‰¹å¾
- ç³»ç»Ÿå…¼å®¹æ€§
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ äº‘ç¯å¢ƒè‡ªåŠ¨åŒ–**
```
ä¼ ç»Ÿéƒ¨ç½²é—®é¢˜ï¼š
âŒ æ‰‹åŠ¨é…ç½®è€—æ—¶ä¸”æ˜“é”™
âŒ ç¯å¢ƒä¸ä¸€è‡´å¯¼è‡´é—®é¢˜
âŒ æ‰©å®¹æ—¶é‡å¤åŠ³åŠ¨

cloud-initè§£å†³æ–¹æ¡ˆï¼š
âœ… é…ç½®æ ‡å‡†åŒ–å’Œç‰ˆæœ¬æ§åˆ¶
âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå‡å°‘äººä¸ºé”™è¯¯
âœ… å¿«é€Ÿæ‰©å®¹ï¼Œç¯å¢ƒä¸€è‡´æ€§
```

**ğŸ› ï¸ è¿ç»´æœ€ä½³å®è·µ**
```
é…ç½®ç®¡ç†ï¼š
- ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®æ–‡ä»¶
- æµ‹è¯•ç¯å¢ƒéªŒè¯åéƒ¨ç½²ç”Ÿäº§
- å¤‡ä»½é‡è¦é…ç½®å’Œæ•°æ®

ç›‘æ§ç­–ç•¥ï¼š
- ç›‘æ§ç£ç›˜ä½¿ç”¨ç‡
- æ£€æŸ¥æŒ‚è½½çŠ¶æ€
- éªŒè¯æœåŠ¡å¯åŠ¨çŠ¶æ€

æ•…éšœå¤„ç†ï¼š
- ç†Ÿæ‚‰å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ³•
- å‡†å¤‡å›æ»šæ–¹æ¡ˆ
- å»ºç«‹æ•…éšœå¤„ç†æµç¨‹
```

### 8.4 å­¦ä¹ æ£€æŸ¥æ¸…å•


**âœ… çŸ¥è¯†æŒæ¡æ£€æŸ¥**
- [ ] èƒ½å¤Ÿç¼–å†™write_filesé…ç½®åˆ›å»ºé…ç½®æ–‡ä»¶
- [ ] ç†è§£æ–‡ä»¶æƒé™å«ä¹‰å¹¶æ­£ç¡®è®¾ç½®
- [ ] èƒ½å¤Ÿé…ç½®ç£ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿ
- [ ] æŒæ¡å„ç§æŒ‚è½½é€‰é¡¹çš„ä½¿ç”¨åœºæ™¯
- [ ] äº†è§£tmpfsçš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯
- [ ] èƒ½å¤Ÿè®¾è®¡å®Œæ•´çš„å­˜å‚¨é…ç½®æ–¹æ¡ˆ

**ğŸ“Š å®è·µèƒ½åŠ›è¯„ä¼°**
```
åŸºç¡€åº”ç”¨ï¼šâ­â­â­â­â­ 
- åˆ›å»ºé…ç½®æ–‡ä»¶å’Œè„šæœ¬

è¿›é˜¶é…ç½®ï¼šâ­â­â­â­â˜†
- ç£ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿç®¡ç†

é«˜çº§ä¼˜åŒ–ï¼šâ­â­â­â˜†â˜†  
- æ€§èƒ½è°ƒä¼˜å’Œå®‰å…¨åŠ å›º

æ•…éšœå¤„ç†ï¼šâ­â­â˜†â˜†â˜†
- é—®é¢˜è¯Šæ–­å’Œè§£å†³èƒ½åŠ›
```

**ğŸ¯ ä¸€å¥è¯ç²¾å**
cloud-initæ–‡ä»¶ç³»ç»Ÿé…ç½®å°±åƒç»™æ–°æˆ¿å­è£…ä¿®ï¼šå…ˆè§„åˆ’æˆ¿é—´å¸ƒå±€(åˆ†åŒº)ï¼Œå†è£…ä¿®æˆ¿é—´(æ ¼å¼åŒ–)ï¼Œç„¶åå®‰è£…å®¶å…·(æŒ‚è½½)ï¼Œæœ€åæ‘†æ”¾ç‰©å“(å†™å…¥æ–‡ä»¶)ã€‚

**ğŸ§  è®°å¿†é”šç‚¹**
```
é…ç½®é¡ºåºï¼šdisk â†’ fs â†’ mount â†’ write
æ–‡ä»¶æƒé™ï¼š644æ™®é€šï¼Œ755æ‰§è¡Œï¼Œ600ä¿å¯†
æ–‡ä»¶ç³»ç»Ÿï¼šext4é€šç”¨ï¼Œxfsé«˜æ€§èƒ½ï¼Œtmpfsé«˜é€Ÿ
æŒ‚è½½é€‰é¡¹ï¼šé»˜è®¤å®‰å…¨ï¼Œæ€§èƒ½ä¼˜åŒ–ï¼Œç‰¹æ®Šéœ€æ±‚
```