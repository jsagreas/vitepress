---
title: 6ã€ç«¯å£ä¸æœåŠ¡è¿æ¥é—®é¢˜
---
## ğŸ“š ç›®å½•

1. [ç«¯å£çŠ¶æ€æ£€æŸ¥åŸºç¡€](#1-ç«¯å£çŠ¶æ€æ£€æŸ¥åŸºç¡€)
2. [æœåŠ¡ç«¯å£ç›‘å¬è¯Šæ–­](#2-æœåŠ¡ç«¯å£ç›‘å¬è¯Šæ–­)
3. [é˜²ç«å¢™ç«¯å£è§„åˆ™ç®¡ç†](#3-é˜²ç«å¢™ç«¯å£è§„åˆ™ç®¡ç†)
4. [ç«¯å£å ç”¨å†²çªè§£å†³](#4-ç«¯å£å ç”¨å†²çªè§£å†³)
5. [TCPè¿æ¥çŠ¶æ€æ·±åº¦åˆ†æ](#5-TCPè¿æ¥çŠ¶æ€æ·±åº¦åˆ†æ)
6. [æœåŠ¡å¯åŠ¨å¤±è´¥æ’æŸ¥](#6-æœåŠ¡å¯åŠ¨å¤±è´¥æ’æŸ¥)
7. [ç«¯å£è½¬å‘é…ç½®è¯Šæ–­](#7-ç«¯å£è½¬å‘é…ç½®è¯Šæ–­)
8. [Socketè¿æ¥è¶…æ—¶é—®é¢˜](#8-Socketè¿æ¥è¶…æ—¶é—®é¢˜)
9. [ç»¼åˆè¯Šæ–­å®æˆ˜æ¡ˆä¾‹](#9-ç»¼åˆè¯Šæ–­å®æˆ˜æ¡ˆä¾‹)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç«¯å£çŠ¶æ€æ£€æŸ¥åŸºç¡€


### 1.1 ç«¯å£çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç«¯å£ï¼Ÿ**
```
ç®€å•ç†è§£ï¼šç«¯å£å°±åƒæˆ¿å­çš„é—¨ç‰Œå·
- æ¯ä¸ªç½‘ç»œæœåŠ¡éƒ½æœ‰è‡ªå·±çš„"é—¨ç‰Œå·"
- å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ª"é—¨ç‰Œå·"æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡
- ä¸€å°æœºå™¨å¯ä»¥åŒæ—¶å¼€æ”¾å¤šä¸ªç«¯å£æä¾›ä¸åŒæœåŠ¡

å¸¸è§ç«¯å£ä¸¾ä¾‹ï¼š
ğŸŒ HTTPæœåŠ¡ï¼š80ç«¯å£
ğŸ”’ HTTPSæœåŠ¡ï¼š443ç«¯å£  
ğŸ“§ SSHæœåŠ¡ï¼š22ç«¯å£
ğŸ“‚ FTPæœåŠ¡ï¼š21ç«¯å£
```

### 1.2 netstatå‘½ä»¤æ·±å…¥ç†è§£


**netstatæ˜¯ä»€ä¹ˆï¼Ÿ**
> ğŸ’¡ **æ¦‚å¿µè§£é‡Š**ï¼šnetstat = network statisticsï¼Œç½‘ç»œç»Ÿè®¡å·¥å…·
> ä½œç”¨ï¼šæ˜¾ç¤ºç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨ã€æ¥å£ç»Ÿè®¡ç­‰ç½‘ç»œç›¸å…³ä¿¡æ¯

**æ ¸å¿ƒå‚æ•°è¯¦è§£**
```bash
# æœ€å¸¸ç”¨çš„ç»„åˆ
netstat -tuln

å‚æ•°å«ä¹‰ï¼š
-t  æ˜¾ç¤ºTCPè¿æ¥
-u  æ˜¾ç¤ºUDPè¿æ¥  
-l  åªæ˜¾ç¤ºç›‘å¬çŠ¶æ€çš„ç«¯å£
-n  ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºï¼ˆä¸è§£æåŸŸåå’ŒæœåŠ¡åï¼‰
```

**å®é™…è¾“å‡ºè§£è¯»**
```
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN

è§£è¯»è¯´æ˜ï¼š
ğŸ“ Protoï¼šåè®®ç±»å‹ï¼ˆtcp/udpï¼‰
ğŸ“ Local Addressï¼šæœ¬åœ°åœ°å€å’Œç«¯å£
ğŸ“ Foreign Addressï¼šè¿œç¨‹åœ°å€å’Œç«¯å£
ğŸ“ Stateï¼šè¿æ¥çŠ¶æ€
```

### 1.3 sså‘½ä»¤ç°ä»£æ›¿ä»£æ–¹æ¡ˆ


**ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ssï¼Ÿ**
```
ss vs netstat å¯¹æ¯”ï¼š

âœ… sså‘½ä»¤ä¼˜åŠ¿ï¼š
- é€Ÿåº¦æ›´å¿«ï¼ˆç›´æ¥è¯»å–å†…æ ¸ä¿¡æ¯ï¼‰
- æ˜¾ç¤ºä¿¡æ¯æ›´è¯¦ç»†
- æ”¯æŒæ›´å¤šè¿‡æ»¤é€‰é¡¹
- ç°ä»£Linuxç³»ç»Ÿé»˜è®¤å·¥å…·

âŒ netstatå±€é™ï¼š
- éœ€è¦éå†/procç›®å½•ï¼ˆè¾ƒæ…¢ï¼‰
- æŸäº›å‘è¡Œç‰ˆéœ€è¦é¢å¤–å®‰è£…
```

**sså‘½ä»¤å®ç”¨ç¤ºä¾‹**
```bash
# æ˜¾ç¤ºæ‰€æœ‰ç›‘å¬ç«¯å£
ss -tuln

# æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ï¼ˆéœ€è¦rootæƒé™ï¼‰
ss -tulnp

# æŒ‰çŠ¶æ€è¿‡æ»¤
ss -t state listening
ss -t state established
```

---

## 2. ğŸ¯ æœåŠ¡ç«¯å£ç›‘å¬è¯Šæ–­


### 2.1 ç›‘å¬çŠ¶æ€çš„å«ä¹‰


**ä»€ä¹ˆå«"ç›‘å¬"ï¼Ÿ**
```
ç”Ÿæ´»åŒ–ç†è§£ï¼š
ğŸ  æˆ¿å­å»ºå¥½äº†ï¼ˆæœåŠ¡å®‰è£…ï¼‰
ğŸšª é—¨å¼€ç€ç­‰å®¢äººï¼ˆç«¯å£ç›‘å¬ï¼‰
ğŸ‘¤ æœ‰äººæ•²é—¨å°±æ¥å¾…ï¼ˆå¤„ç†è¿æ¥è¯·æ±‚ï¼‰

æŠ€æœ¯è§’åº¦ï¼š
- æœåŠ¡å¯åŠ¨åç»‘å®šåˆ°æŒ‡å®šç«¯å£
- ç³»ç»Ÿå†…æ ¸ä¸ºè¯¥ç«¯å£åˆ†é…socket
- ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚
```

### 2.2 æ£€æŸ¥æœåŠ¡ç›‘å¬çŠ¶æ€


**åŸºç¡€æ£€æŸ¥æ–¹æ³•**
```bash
# æ£€æŸ¥ç‰¹å®šç«¯å£æ˜¯å¦ç›‘å¬
ss -tuln | grep :80

# æ£€æŸ¥è¿›ç¨‹å ç”¨ç«¯å£
ss -tulnp | grep :80

# æ£€æŸ¥æ‰€æœ‰ç›‘å¬ç«¯å£
ss -tuln
```

**ç›‘å¬åœ°å€çš„åŒºåˆ«**
```
åœ°å€ç»‘å®šç±»å‹è§£é‡Šï¼š

0.0.0.0:80     â† æ‰€æœ‰ç½‘å¡éƒ½å¯ä»¥è®¿é—®
127.0.0.1:80   â† åªèƒ½æœ¬æœºè®¿é—®ï¼ˆå›ç¯æ¥å£ï¼‰
192.168.1.10:80 â† åªèƒ½é€šè¿‡ç‰¹å®šIPè®¿é—®

å®é™…æ„ä¹‰ï¼š
- å¦‚æœæ˜¾ç¤º127.0.0.1:80ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®
- éœ€è¦ä¿®æ”¹é…ç½®è®©æœåŠ¡ç»‘å®šåˆ°0.0.0.0æˆ–å…·ä½“IP
```

### 2.3 å¸¸è§æœåŠ¡é…ç½®æ£€æŸ¥


**WebæœåŠ¡å™¨ç›‘å¬é…ç½®**
```bash
# Apacheé…ç½®æ£€æŸ¥
grep -i listen /etc/apache2/ports.conf
grep -i listen /etc/httpd/conf/httpd.conf

# Nginxé…ç½®æ£€æŸ¥  
grep -i listen /etc/nginx/nginx.conf
grep -i listen /etc/nginx/sites-enabled/*
```

**æ•°æ®åº“æœåŠ¡ç›‘å¬**
```bash
# MySQLé…ç½®
grep bind-address /etc/mysql/mysql.conf.d/mysqld.cnf

# PostgreSQLé…ç½®
grep listen_addresses /etc/postgresql/*/main/postgresql.conf
```

---

## 3. ğŸ›¡ï¸ é˜²ç«å¢™ç«¯å£è§„åˆ™ç®¡ç†


### 3.1 é˜²ç«å¢™åŸºæœ¬æ¦‚å¿µ


**é˜²ç«å¢™çš„ä½œç”¨**
```
å½¢è±¡æ¯”å–»ï¼šé˜²ç«å¢™åƒå°åŒºä¿å®‰
ğŸ‘® æ£€æŸ¥æ¯ä¸ªè¿›å‡ºçš„äººï¼ˆæ•°æ®åŒ…ï¼‰
ğŸ“‹ æŒ‰ç…§è§„å®šæ”¾è¡Œæˆ–æ‹’ç»ï¼ˆè§„åˆ™åŒ¹é…ï¼‰
ğŸ”’ ä¿æŠ¤å†…éƒ¨å®‰å…¨ï¼ˆç½‘ç»œå®‰å…¨ï¼‰

æŠ€æœ¯å±‚é¢ï¼š
- æ ¹æ®è§„åˆ™è¿‡æ»¤ç½‘ç»œæµé‡
- å¯ä»¥æŒ‰ç«¯å£ã€IPã€åè®®è¿›è¡Œæ§åˆ¶
- é»˜è®¤ç­–ç•¥é€šå¸¸æ˜¯æ‹’ç»å¤–éƒ¨è¿æ¥
```

### 3.2 iptablesé˜²ç«å¢™è¯Šæ–­


**æ£€æŸ¥å½“å‰è§„åˆ™**
```bash
# æŸ¥çœ‹æ‰€æœ‰è§„åˆ™
iptables -L -n -v

# æŸ¥çœ‹ç‰¹å®šé“¾çš„è§„åˆ™
iptables -L INPUT -n -v
iptables -L OUTPUT -n -v
```

**å¸¸è§è§„åˆ™è§£è¯»**
```
Chain INPUT (policy ACCEPT)
target     prot opt source      destination         
ACCEPT     tcp  --  0.0.0.0/0   0.0.0.0/0    tcp dpt:22
ACCEPT     tcp  --  0.0.0.0/0   0.0.0.0/0    tcp dpt:80
DROP       all  --  0.0.0.0/0   0.0.0.0/0           

è§£è¯»ï¼š
âœ… ACCEPT tcp dpt:22  â† å…è®¸SSHè¿æ¥
âœ… ACCEPT tcp dpt:80  â† å…è®¸HTTPè¿æ¥  
âŒ DROP all           â† æ‹’ç»å…¶ä»–æ‰€æœ‰è¿æ¥
```

### 3.3 firewalldé˜²ç«å¢™ç®¡ç†


**ç°ä»£é˜²ç«å¢™å·¥å…·**
```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
systemctl status firewalld
firewall-cmd --state

# æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£
firewall-cmd --list-ports
firewall-cmd --list-services

# ä¸´æ—¶å¼€æ”¾ç«¯å£ï¼ˆé‡å¯å¤±æ•ˆï¼‰
firewall-cmd --add-port=8080/tcp

# æ°¸ä¹…å¼€æ”¾ç«¯å£
firewall-cmd --add-port=8080/tcp --permanent
firewall-cmd --reload
```

---

## 4. âš”ï¸ ç«¯å£å ç”¨å†²çªè§£å†³


### 4.1 ç«¯å£å†²çªçš„åŸç†


**ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿç«¯å£å†²çªï¼Ÿ**
```
åŸç†è¯´æ˜ï¼š
- æ¯ä¸ªç«¯å£åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨
- å¦‚æœä¸¤ä¸ªç¨‹åºéƒ½æƒ³ç”¨åŒä¸€ä¸ªç«¯å£ï¼Œåå¯åŠ¨çš„ä¼šå¤±è´¥
- è¿™å°±åƒä¸¤ä¸ªäººæƒ³ååŒä¸€æŠŠæ¤…å­ï¼Œå…ˆåˆ°å…ˆå¾—

å¸¸è§å†²çªåœºæ™¯ï¼š
â— å¯åŠ¨Apacheæ—¶æç¤º80ç«¯å£è¢«å ç”¨
â— å¯åŠ¨æ•°æ®åº“æ—¶æç¤º3306ç«¯å£å†²çª  
â— å¼€å‘ç¯å¢ƒç«¯å£ä¸ç³»ç»ŸæœåŠ¡å†²çª
```

### 4.2 æŸ¥æ‰¾ç«¯å£å ç”¨è¿›ç¨‹


**ç²¾å‡†å®šä½å ç”¨è¿›ç¨‹**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨sså‘½ä»¤
ss -tulnp | grep :80

# æ–¹æ³•2ï¼šä½¿ç”¨netstatå‘½ä»¤  
netstat -tulnp | grep :80

# æ–¹æ³•3ï¼šä½¿ç”¨lsofå‘½ä»¤
lsof -i :80

è¾“å‡ºç¤ºä¾‹ï¼š
tcp   0   0  0.0.0.0:80   0.0.0.0:*   LISTEN   1234/nginx
                                             â†‘
                                        è¿›ç¨‹ID/è¿›ç¨‹å
```

### 4.3 è§£å†³ç«¯å£å†²çª


**è§£å†³æ–¹æ¡ˆé€‰æ‹©**
```
è§£å†³æ€è·¯çŸ©é˜µï¼š

æƒ…å†µ1ï¼šä¸éœ€è¦çš„è¿›ç¨‹å ç”¨
â†’ ç›´æ¥æ€æ‰è¿›ç¨‹ï¼škill -9 PID

æƒ…å†µ2ï¼šç³»ç»Ÿé‡è¦æœåŠ¡å ç”¨
â†’ ä¿®æ”¹æ–°æœåŠ¡çš„ç«¯å£é…ç½®

æƒ…å†µ3ï¼šä¸¤ä¸ªæœåŠ¡éƒ½éœ€è¦
â†’ ä½¿ç”¨ä¸åŒç«¯å£æˆ–è´Ÿè½½å‡è¡¡

æƒ…å†µ4ï¼šè¿›ç¨‹å·²æ­»ä½†ç«¯å£æœªé‡Šæ”¾
â†’ ç­‰å¾…è¶…æ—¶æˆ–é‡å¯æœåŠ¡
```

**å®é™…æ“ä½œç¤ºä¾‹**
```bash
# 1. æ‰¾åˆ°å ç”¨è¿›ç¨‹
lsof -i :8080
# è¾“å‡ºï¼šjava 12345 user ... 

# 2. æ£€æŸ¥è¿›ç¨‹è¯¦æƒ…
ps aux | grep 12345

# 3. ä¼˜é›…åœæ­¢ï¼ˆæ¨èï¼‰
kill -15 12345

# 4. å¼ºåˆ¶åœæ­¢ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
kill -9 12345

# 5. éªŒè¯ç«¯å£é‡Šæ”¾
ss -tuln | grep :8080
```

---

## 5. ğŸ“Š TCPè¿æ¥çŠ¶æ€æ·±åº¦åˆ†æ


### 5.1 TCPçŠ¶æ€æœºç†è§£


**TCPè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸ**
```
è¿æ¥å»ºç«‹è¿‡ç¨‹ï¼š
å®¢æˆ·ç«¯                    æœåŠ¡å™¨
   |                        |
   |â”€â”€[SYN]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’| (SYN_RECV)
   |â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[SYN,ACK]â”€â”€| 
   |â”€â”€[ACK]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’| (ESTABLISHED)
   |                        |
  è¿æ¥å»ºç«‹å®Œæˆï¼Œå¼€å§‹æ•°æ®ä¼ è¾“
```

**å¸¸è§è¿æ¥çŠ¶æ€å«ä¹‰**
```
çŠ¶æ€é€ŸæŸ¥è¡¨ï¼š

ğŸŸ¢ LISTEN      â† æœåŠ¡ç­‰å¾…è¿æ¥
ğŸ”„ SYN_SENT    â† å®¢æˆ·ç«¯å‘èµ·è¿æ¥
ğŸ”„ SYN_RECV    â† æœåŠ¡ç«¯æ”¶åˆ°è¿æ¥è¯·æ±‚
âœ… ESTABLISHED â† è¿æ¥å»ºç«‹ï¼Œæ­£å¸¸é€šä¿¡
ğŸ”š FIN_WAIT1   â† ä¸»åŠ¨å…³é—­ï¼Œç­‰å¾…ç¡®è®¤
ğŸ”š FIN_WAIT2   â† ç­‰å¾…å¯¹æ–¹å…³é—­
ğŸ”š TIME_WAIT   â† è¿æ¥å…³é—­ï¼Œç­‰å¾…å¯èƒ½çš„é‡ä¼ åŒ…
âŒ CLOSE_WAIT  â† è¢«åŠ¨å…³é—­ï¼Œç­‰å¾…ç¨‹åºå¤„ç†
```

### 5.2 å¼‚å¸¸çŠ¶æ€è¯Šæ–­


**TIME_WAITçŠ¶æ€è¿‡å¤š**
```bash
# ç»Ÿè®¡å„çŠ¶æ€è¿æ¥æ•°
ss -tan | awk 'NR>1 {++S[$1]} END {for(a in S) print a, S[a]}'

å¸¸è§è¾“å‡ºï¼š
LISTEN 10
ESTAB 50  
TIME-WAIT 500  â† å¦‚æœè¿™ä¸ªæ•°å­—å¾ˆå¤§ï¼Œéœ€è¦å…³æ³¨
```

**TIME_WAITè¿‡å¤šçš„å½±å“å’Œè§£å†³**
```
å½±å“åˆ†æï¼š
âš ï¸ å ç”¨å¤§é‡æ–‡ä»¶æè¿°ç¬¦
âš ï¸ å¯èƒ½å¯¼è‡´æ–°è¿æ¥å»ºç«‹å¤±è´¥
âš ï¸ åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å°¤å…¶æ˜æ˜¾

è§£å†³æ–¹æ³•ï¼š
# 1. è°ƒæ•´å†…æ ¸å‚æ•°ï¼ˆè°¨æ…æ“ä½œï¼‰
echo 1 > /proc/sys/net/ipv4/tcp_tw_reuse
echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle

# 2. åº”ç”¨å±‚ä¼˜åŒ–
- ä½¿ç”¨è¿æ¥æ± 
- å¼€å¯HTTP Keep-Alive
- ä¼˜åŒ–ç¨‹åºè¿æ¥ç®¡ç†
```

### 5.3 è¿æ¥å¼‚å¸¸æ’æŸ¥


**CLOSE_WAITçŠ¶æ€å †ç§¯**
```
åŸå› åˆ†æï¼š
- å¯¹æ–¹å·²ç»å…³é—­è¿æ¥
- ä½†æœ¬åœ°ç¨‹åºæ²¡æœ‰æ­£ç¡®å¤„ç†å…³é—­äº‹ä»¶
- é€šå¸¸æ˜¯ç¨‹åºbugå¯¼è‡´

æ’æŸ¥æ­¥éª¤ï¼š
1. æ‰¾åˆ°ç›¸å…³è¿›ç¨‹
2. æ£€æŸ¥ç¨‹åºæ—¥å¿—
3. æŸ¥çœ‹ä»£ç ä¸­socketå…³é—­é€»è¾‘
4. å¿…è¦æ—¶é‡å¯æœåŠ¡
```

---

## 6. ğŸš¨ æœåŠ¡å¯åŠ¨å¤±è´¥æ’æŸ¥


### 6.1 å¯åŠ¨å¤±è´¥çš„å¸¸è§åŸå› 


**å¤±è´¥åŸå› åˆ†ç±»**
```
â‘  ç«¯å£ç›¸å…³é—®é¢˜ï¼š
   - ç«¯å£è¢«å ç”¨
   - æƒé™ä¸è¶³ï¼ˆå°äº1024ç«¯å£éœ€è¦rootï¼‰
   - ç›‘å¬åœ°å€é…ç½®é”™è¯¯

â‘¡ é…ç½®æ–‡ä»¶é—®é¢˜ï¼š
   - è¯­æ³•é”™è¯¯
   - è·¯å¾„ä¸å­˜åœ¨
   - æƒé™ä¸è¶³

â‘¢ ä¾èµ–æœåŠ¡é—®é¢˜ï¼š
   - æ•°æ®åº“æœªå¯åŠ¨
   - ç½‘ç»œä¸å¯è¾¾
   - ä¾èµ–åŒ…ç¼ºå¤±
```

### 6.2 ç³»ç»Ÿæ—¥å¿—æŸ¥çœ‹


**æ—¥å¿—æŸ¥çœ‹æŠ€å·§**
```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
journalctl -u servicename
journalctl -u servicename -f    # å®æ—¶æŸ¥çœ‹

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯
journalctl -p err -n 50

# æŒ‰æ—¶é—´èŒƒå›´æŸ¥çœ‹
journalctl -u nginx --since "2 hours ago"
```

### 6.3 Apacheå¯åŠ¨å¤±è´¥æ¡ˆä¾‹


**å…¸å‹é”™è¯¯åˆ†æ**
```bash
# å¯åŠ¨Apache
systemctl start apache2

# å¦‚æœå¤±è´¥ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯
systemctl status apache2
journalctl -u apache2

å¸¸è§é”™è¯¯ä¿¡æ¯ï¼š
(98)Address already in use: make_sock: could not bind to address [::]:80
è§£å†³ï¼šæ£€æŸ¥80ç«¯å£å ç”¨æƒ…å†µ

AH00558: apache2: Could not reliably determine the server's FQDN
è§£å†³ï¼šé…ç½®ServerNameæŒ‡ä»¤
```

---

## 7. ğŸ”€ ç«¯å£è½¬å‘é…ç½®è¯Šæ–­


### 7.1 ç«¯å£è½¬å‘åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç«¯å£è½¬å‘ï¼Ÿ**
```
ç®€å•ç†è§£ï¼šç«¯å£è½¬å‘å°±åƒå¿«é€’è½¬å¯„
ğŸ“¦ åŒ…è£¹å¯„åˆ°ä¸­è½¬ç«™ï¼ˆè½¬å‘æœåŠ¡å™¨ï¼‰
ğŸšš ä¸­è½¬ç«™æŒ‰åœ°å€è½¬å‘åˆ°ç›®çš„åœ°ï¼ˆç›®æ ‡æœåŠ¡å™¨ï¼‰
ğŸ“ å¯„ä»¶äººä¸çŸ¥é“æœ€ç»ˆåœ°å€åœ¨å“ªé‡Œ

æŠ€æœ¯åœºæ™¯ï¼š
- å†…ç½‘æœåŠ¡å¯¹å¤–è®¿é—®
- è´Ÿè½½å‡è¡¡
- åå‘ä»£ç†
- NATç©¿é€
```

### 7.2 iptablesç«¯å£è½¬å‘


**è½¬å‘è§„åˆ™é…ç½®**
```bash
# å¼€å¯IPè½¬å‘
echo 1 > /proc/sys/net/ipv4/ip_forward

# é…ç½®ç«¯å£è½¬å‘è§„åˆ™
iptables -t nat -A PREROUTING -p tcp --dport 8080 \
  -j DNAT --to-destination 192.168.1.10:80

# é…ç½®å‡ºç«™è§„åˆ™
iptables -t nat -A POSTROUTING -p tcp -d 192.168.1.10 \
  --dport 80 -j SNAT --to-source 192.168.1.1
```

### 7.3 SSHéš§é“è½¬å‘


**æœ¬åœ°ç«¯å£è½¬å‘**
```bash
# å°†æœ¬åœ°8080ç«¯å£è½¬å‘åˆ°è¿œç¨‹æœåŠ¡å™¨çš„80ç«¯å£
ssh -L 8080:localhost:80 user@remote-server

è®¿é—®æµ‹è¯•ï¼š
curl http://localhost:8080  # å®é™…è®¿é—®remote-server:80
```

**åŠ¨æ€ç«¯å£è½¬å‘ï¼ˆSOCKSä»£ç†ï¼‰**
```bash
# åˆ›å»ºSOCKSä»£ç†
ssh -D 8080 user@remote-server

# æµè§ˆå™¨è®¾ç½®SOCKSä»£ç†ï¼šlocalhost:8080
```

---

## 8. â° Socketè¿æ¥è¶…æ—¶é—®é¢˜


### 8.1 è¶…æ—¶é—®é¢˜çš„ç±»å‹


**è¿æ¥è¶…æ—¶ vs è¯»å†™è¶…æ—¶**
```
è¿æ¥è¶…æ—¶ï¼ˆConnection Timeoutï¼‰ï¼š
ğŸ”Œ å»ºç«‹è¿æ¥é˜¶æ®µå¤±è´¥
â±ï¸ é€šå¸¸å‡ ç§’åˆ°å‡ åç§’
ğŸš« å¯¹æ–¹æœåŠ¡ä¸å¯è¾¾æˆ–ä¸å“åº”

è¯»å†™è¶…æ—¶ï¼ˆRead/Write Timeoutï¼‰ï¼š
ğŸ“¡ è¿æ¥å·²å»ºç«‹ï¼Œä½†æ•°æ®ä¼ è¾“è¶…æ—¶
â±ï¸ å¯èƒ½å‡ åˆ†é’Ÿåˆ°æ›´é•¿æ—¶é—´
ğŸŒ ç½‘ç»œæ…¢æˆ–æœåŠ¡å™¨å¤„ç†æ…¢
```

### 8.2 è¶…æ—¶å‚æ•°è°ƒä¼˜


**TCPè¿æ¥ç›¸å…³å‚æ•°**
```bash
# æŸ¥çœ‹å½“å‰è¶…æ—¶é…ç½®
cat /proc/sys/net/ipv4/tcp_syn_retries      # SYNé‡è¯•æ¬¡æ•°
cat /proc/sys/net/ipv4/tcp_synack_retries   # SYN-ACKé‡è¯•æ¬¡æ•°
cat /proc/sys/net/ipv4/tcp_keepalive_time   # ä¿æ´»æ—¶é—´

# ä¸´æ—¶è°ƒæ•´ï¼ˆé‡å¯å¤±æ•ˆï¼‰
echo 3 > /proc/sys/net/ipv4/tcp_syn_retries

# æ°¸ä¹…è°ƒæ•´ï¼ˆå†™å…¥/etc/sysctl.confï¼‰
net.ipv4.tcp_syn_retries = 3
net.ipv4.tcp_keepalive_time = 600
```

### 8.3 åº”ç”¨å±‚è¶…æ—¶è®¾ç½®


**å¸¸è§åº”ç”¨è¶…æ—¶é…ç½®**
```bash
# Nginxè¶…æ—¶é…ç½®
client_header_timeout 60s;
client_body_timeout 60s;
send_timeout 60s;
proxy_connect_timeout 60s;
proxy_send_timeout 60s;
proxy_read_timeout 60s;

# Apacheè¶…æ—¶é…ç½®  
Timeout 300
KeepAliveTimeout 5
```

---

## 9. ğŸ¯ ç»¼åˆè¯Šæ–­å®æˆ˜æ¡ˆä¾‹


### 9.1 WebæœåŠ¡æ— æ³•è®¿é—®æ¡ˆä¾‹


**æ•…éšœç°è±¡**
```
â— ç”¨æˆ·åé¦ˆç½‘ç«™æ‰“ä¸å¼€
â— æµè§ˆå™¨æ˜¾ç¤º"è¿æ¥è¢«æ‹’ç»"
â— curlæµ‹è¯•ä¹Ÿå¤±è´¥
```

**è¯Šæ–­æµç¨‹**
```
ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status nginx
systemctl status apache2

ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥ç«¯å£ç›‘å¬
ss -tuln | grep :80
ss -tuln | grep :443

ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥é˜²ç«å¢™
firewall-cmd --list-ports
iptables -L -n | grep 80

ç¬¬å››æ­¥ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶
nginx -t
apache2ctl configtest

ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
tail -f /var/log/apache2/error.log
```

### 9.2 æ•°æ®åº“è¿æ¥é—®é¢˜æ¡ˆä¾‹


**æ•…éšœç°è±¡**
```
â— åº”ç”¨æŠ¥æ•°æ®åº“è¿æ¥å¤±è´¥
â— æœ¬åœ°è¿æ¥æ­£å¸¸ï¼Œè¿œç¨‹è¿æ¥å¤±è´¥
```

**è¯Šæ–­æ­¥éª¤**
```bash
# 1. æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
systemctl status mysql
systemctl status postgresql

# 2. æ£€æŸ¥ç›‘å¬åœ°å€
ss -tuln | grep :3306   # MySQL
ss -tuln | grep :5432   # PostgreSQL

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ç»‘å®šåœ°å€
grep bind-address /etc/mysql/mysql.conf.d/mysqld.cnf
# å¦‚æœæ˜¯ 127.0.0.1ï¼Œéœ€è¦æ”¹ä¸º 0.0.0.0

# 4. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
firewall-cmd --list-ports
# éœ€è¦å¼€æ”¾å¯¹åº”ç«¯å£

# 5. æµ‹è¯•è¿æ¥
telnet database-server 3306
nc -zv database-server 3306
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºç¡€å‘½ä»¤


```
ğŸ” ç«¯å£æ£€æŸ¥ï¼š
ss -tuln          â† æŸ¥çœ‹æ‰€æœ‰ç›‘å¬ç«¯å£
ss -tulnp         â† æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯
lsof -i :ç«¯å£     â† æŸ¥çœ‹ç«¯å£å ç”¨è¿›ç¨‹

ğŸ›¡ï¸ é˜²ç«å¢™æ£€æŸ¥ï¼š
firewall-cmd --list-ports    â† æŸ¥çœ‹å¼€æ”¾ç«¯å£
iptables -L -n               â† æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™

ğŸ“Š è¿æ¥çŠ¶æ€ï¼š
ss -tan                      â† æŸ¥çœ‹TCPè¿æ¥çŠ¶æ€
netstat -tan                 â† å¤‡ç”¨æ–¹æ¡ˆ

ğŸš¨ æœåŠ¡è¯Šæ–­ï¼š
systemctl status æœåŠ¡å      â† æ£€æŸ¥æœåŠ¡çŠ¶æ€
journalctl -u æœåŠ¡å         â† æŸ¥çœ‹æœåŠ¡æ—¥å¿—
```

### 10.2 å…³é”®è¯Šæ–­æ€è·¯


**ğŸ”¹ ç«¯å£é—®é¢˜è¯Šæ–­é¡ºåº**
```
â‘  æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Ÿ
   systemctl status servicename

â‘¡ ç«¯å£æ˜¯å¦ç›‘å¬ï¼Ÿ  
   ss -tuln | grep :port

â‘¢ é˜²ç«å¢™æ˜¯å¦é˜»æŒ¡ï¼Ÿ
   firewall-cmd --list-ports

â‘£ ç½‘ç»œæ˜¯å¦é€šç•…ï¼Ÿ
   telnet ip port
   nc -zv ip port
```

**ğŸ”¹ TCPçŠ¶æ€å¼‚å¸¸å¤„ç†**
```
TIME_WAITè¿‡å¤šï¼š
- æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£ç¡®å¤ç”¨è¿æ¥
- è€ƒè™‘è°ƒæ•´å†…æ ¸å‚æ•°
- ä½¿ç”¨è¿æ¥æ± æŠ€æœ¯

CLOSE_WAITå †ç§¯ï¼š
- ç¨‹åºbugï¼Œæ²¡æœ‰æ­£ç¡®å…³é—­socket
- é‡å¯åº”ç”¨æˆ–ä¿®å¤ä»£ç 
- æ£€æŸ¥ç¨‹åºçš„é”™è¯¯å¤„ç†é€»è¾‘
```

### 10.3 å®æˆ˜ç»éªŒæ€»ç»“


**ğŸ’¡ å¸¸è§è¯¯åŒºé¿å…**
```
âŒ åªçœ‹ç«¯å£ç›‘å¬ï¼Œå¿½ç•¥ç›‘å¬åœ°å€
   æ­£ç¡®ï¼šåŒºåˆ† 127.0.0.1 å’Œ 0.0.0.0

âŒ åªæ£€æŸ¥é˜²ç«å¢™ï¼Œå¿½ç•¥SELinux
   æ­£ç¡®ï¼šSELinuxä¹Ÿå¯èƒ½é˜»æ­¢ç«¯å£ç»‘å®š

âŒ å¼ºåˆ¶æ€è¿›ç¨‹ä¸æŸ¥åŸå› 
   æ­£ç¡®ï¼šåˆ†æä¸ºä»€ä¹ˆç«¯å£è¢«å ç”¨

âŒ ç›²ç›®è°ƒæ•´å†…æ ¸å‚æ•°  
   æ­£ç¡®ï¼šç†è§£å‚æ•°å«ä¹‰å†è°ƒæ•´
```

**ğŸ¯ æ•ˆç‡æå‡æŠ€å·§**
```
â‘  åˆ¶ä½œå¸¸ç”¨å‘½ä»¤åˆ«å
   alias ports='ss -tuln'
   alias listening='ss -tulnp'

â‘¡ ç¼–å†™ç®€å•æ£€æŸ¥è„šæœ¬
   ä¸€é”®æ£€æŸ¥æœåŠ¡çŠ¶æ€ã€ç«¯å£ã€é˜²ç«å¢™

â‘¢ å»ºç«‹æ•…éšœå¤„ç†æ¸…å•
   æŒ‰ä¼˜å…ˆçº§æ’åˆ—è¯Šæ–­æ­¥éª¤

â‘£ ä¿å­˜å¸¸ç”¨çš„è¯Šæ–­å‘½ä»¤
   å¿«é€Ÿå¤åˆ¶ç²˜è´´ï¼Œæé«˜æ•ˆç‡
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ğŸ” ç«¯å£é—®é¢˜å…ˆæŸ¥ç›‘å¬ï¼Œå†çœ‹é˜²ç«å¢™
- ğŸš¨ æœåŠ¡å¯åŠ¨çœ‹æ—¥å¿—ï¼Œé…ç½®è¯­æ³•è¦æ£€æŸ¥  
- ğŸ“Š è¿æ¥çŠ¶æ€æœ‰å¼‚å¸¸ï¼Œæ‰¾åˆ°æ ¹å› å†å¤„ç†
- â° è¶…æ—¶é—®é¢˜åˆ†å±‚çœ‹ï¼Œç½‘ç»œåº”ç”¨éƒ½è¦æŸ¥