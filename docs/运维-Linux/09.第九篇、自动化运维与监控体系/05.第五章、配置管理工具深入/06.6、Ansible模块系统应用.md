---
title: 6ã€Ansibleæ¨¡å—ç³»ç»Ÿåº”ç”¨
---
## ğŸ“š ç›®å½•

1. [Ansibleæ¨¡å—ç³»ç»Ÿæ¦‚è¿°](#1-Ansibleæ¨¡å—ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒæ¨¡å—åˆ†ç±»ä¸ç‰¹æ€§](#2-æ ¸å¿ƒæ¨¡å—åˆ†ç±»ä¸ç‰¹æ€§)
3. [æ–‡ä»¶æ“ä½œæ¨¡å—è¯¦è§£](#3-æ–‡ä»¶æ“ä½œæ¨¡å—è¯¦è§£)
4. [æœåŠ¡ç®¡ç†æ¨¡å—åº”ç”¨](#4-æœåŠ¡ç®¡ç†æ¨¡å—åº”ç”¨)
5. [åŒ…ç®¡ç†æ¨¡å—ä½¿ç”¨](#5-åŒ…ç®¡ç†æ¨¡å—ä½¿ç”¨)
6. [ç½‘ç»œé…ç½®æ¨¡å—å®è·µ](#6-ç½‘ç»œé…ç½®æ¨¡å—å®è·µ)
7. [äº‘å¹³å°æ¨¡å—é›†æˆ](#7-äº‘å¹³å°æ¨¡å—é›†æˆ)
8. [è‡ªå®šä¹‰æ¨¡å—å¼€å‘åŸºç¡€](#8-è‡ªå®šä¹‰æ¨¡å—å¼€å‘åŸºç¡€)
9. [æ¨¡å—æ–‡æ¡£æŸ¥è¯¢æ–¹æ³•](#9-æ¨¡å—æ–‡æ¡£æŸ¥è¯¢æ–¹æ³•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ Ansibleæ¨¡å—ç³»ç»Ÿæ¦‚è¿°


### 1.1 æ¨¡å—ç³»ç»Ÿçš„æœ¬è´¨


> **Ansibleæ¨¡å—**ï¼šå¯ä»¥ç†è§£ä¸ºAnsibleçš„"å·¥å…·ç®±"ï¼Œæ¯ä¸ªæ¨¡å—å°±æ˜¯ä¸€ä¸ªä¸“é—¨çš„å·¥å…·ï¼Œç”¨æ¥å®Œæˆç‰¹å®šçš„ä»»åŠ¡ã€‚å°±åƒä¿®è½¦å¸ˆå‚…æœ‰æ‰³æ‰‹ã€èºä¸åˆ€ã€åƒæ–¤é¡¶ç­‰ä¸åŒå·¥å…·ä¸€æ ·ã€‚

**ğŸ¯ æ¨¡å—çš„ä½œç”¨æœºåˆ¶**

```
Ansibleæ¨¡å—å·¥ä½œåŸç†ï¼š

æ§åˆ¶èŠ‚ç‚¹(Control Node)
        |
        | 1.å‘é€æ¨¡å—ä»£ç 
        â¬‡
ç›®æ ‡ä¸»æœº(Managed Node)
        |
        | 2.æ‰§è¡Œæ¨¡å—ä»»åŠ¡
        â¬‡
è¿”å›ç»“æœåˆ°æ§åˆ¶èŠ‚ç‚¹
        |
        | 3.æ˜¾ç¤ºæ‰§è¡Œç»“æœ
```

**ğŸ’¡ æ¨¡å— vs å‘½ä»¤çš„åŒºåˆ«**

| **å¯¹æ¯”é¡¹** | **æ¨¡å—(Module)** | **å‘½ä»¤(Command)** |
|-----------|------------------|------------------|
| **æ‰§è¡Œæ–¹å¼** | `é€šè¿‡Ansibleè°ƒç”¨` | `ç›´æ¥åœ¨shellæ‰§è¡Œ` |
| **è·¨å¹³å°æ€§** | `è‡ªåŠ¨é€‚é…ä¸åŒç³»ç»Ÿ` | `éœ€è¦æ‰‹å·¥é€‚é…` |
| **å¹‚ç­‰æ€§** | `å¤©ç„¶å…·å¤‡å¹‚ç­‰æ€§` | `éœ€è¦æ‰‹å·¥å¤„ç†` |
| **é”™è¯¯å¤„ç†** | `ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶` | `éœ€è¦è‡ªå·±å†™é”™è¯¯å¤„ç†` |
| **è¿”å›ä¿¡æ¯** | `ç»“æ„åŒ–çš„è¿”å›æ•°æ®` | `çº¯æ–‡æœ¬è¾“å‡º` |

### 1.2 æ¨¡å—çš„è°ƒç”¨æ–¹å¼


**ğŸš€ ä¸‰ç§å¸¸è§è°ƒç”¨æ–¹å¼**

```yaml
# 1. Ad-Hocå‘½ä»¤è°ƒç”¨ï¼ˆä¸´æ—¶æ‰§è¡Œï¼‰
ansible webservers -m ping
ansible webservers -m shell -a "uptime"

# 2. Playbookä¸­è°ƒç”¨ï¼ˆæ¨èæ–¹å¼ï¼‰
- name: æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
  ping:

# 3. å¸¦å‚æ•°çš„æ¨¡å—è°ƒç”¨
- name: å®‰è£…è½¯ä»¶åŒ…
  yum:
    name: nginx
    state: present
```

### 1.3 æ¨¡å—æ‰§è¡Œçš„å¹‚ç­‰æ€§åŸç†


**ğŸ”„ å¹‚ç­‰æ€§çš„é€šä¿—ç†è§£**

> **å¹‚ç­‰æ€§**ï¼šç®€å•è¯´å°±æ˜¯"åšå¤šå°‘éç»“æœéƒ½ä¸€æ ·"ã€‚æ¯”å¦‚ä½ å‘Šè¯‰Ansible"ç¡®ä¿nginxå·²å®‰è£…"ï¼Œæ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œæœ€ç»ˆç»“æœéƒ½æ˜¯nginxè¢«å®‰è£…ä¸”åªå®‰è£…ä¸€æ¬¡ã€‚

```
å¹‚ç­‰æ€§ç¤ºä¾‹å¯¹æ¯”ï¼š

éå¹‚ç­‰æ“ä½œï¼š
æ¯æ¬¡æ‰§è¡Œ â†’ åˆ›å»ºæ–°æ–‡ä»¶ â†’ ç³»ç»Ÿä¸­æ–‡ä»¶è¶Šæ¥è¶Šå¤š âŒ

å¹‚ç­‰æ“ä½œï¼š
æ¯æ¬¡æ‰§è¡Œ â†’ ç¡®ä¿æ–‡ä»¶å­˜åœ¨ â†’ æ–‡ä»¶åªæœ‰ä¸€ä¸ªï¼ŒçŠ¶æ€ä¸€è‡´ âœ…
```

---

## 2. ğŸ“Š æ ¸å¿ƒæ¨¡å—åˆ†ç±»ä¸ç‰¹æ€§


### 2.1 æ¨¡å—åˆ†ç±»ä½“ç³»


**ğŸ—ï¸ Ansibleæ¨¡å—åˆ†ç±»æ¶æ„**

```
Ansibleæ¨¡å—ä½“ç³»ç»“æ„ï¼š

                    Ansibleæ¨¡å—åº“
                         |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    |         |          |          |         |         |
  ç³»ç»Ÿç®¡ç†   æ–‡ä»¶æ“ä½œ   åŒ…ç®¡ç†    æœåŠ¡ç®¡ç†   ç½‘ç»œé…ç½®  äº‘å¹³å°
    |         |          |          |         |         |
 â”œâ”€user    â”œâ”€copy     â”œâ”€yum      â”œâ”€service â”œâ”€uri    â”œâ”€ec2
 â”œâ”€group   â”œâ”€file     â”œâ”€apt      â”œâ”€systemd â”œâ”€get_urlâ”œâ”€gcp
 â”œâ”€cron    â”œâ”€template â”œâ”€pip      â””â”€docker  â”œâ”€firewalldâ”€azure
 â””â”€mount   â””â”€lineinfileâ”€gem                â””â”€iptables
```

### 2.2 å¸¸ç”¨æ¨¡å—é€ŸæŸ¥è¡¨


| **åˆ†ç±»** | **æ¨¡å—å** | **ä¸»è¦ç”¨é€”** | **ä½¿ç”¨é¢‘ç‡** | **å­¦ä¹ ä¼˜å…ˆçº§** |
|---------|-----------|-------------|-------------|---------------|
| **ğŸ”¥ ç³»ç»ŸåŸºç¡€** | `ping` | `è¿é€šæ€§æµ‹è¯•` | â­â­â­â­â­ | ğŸŸ¢å¿…å­¦ |
| **ğŸ”¥ æ–‡ä»¶æ“ä½œ** | `copy` | `æ–‡ä»¶å¤åˆ¶` | â­â­â­â­â­ | ğŸŸ¢å¿…å­¦ |
| **ğŸ”¥ åŒ…ç®¡ç†** | `yum/apt` | `è½¯ä»¶åŒ…å®‰è£…` | â­â­â­â­â­ | ğŸŸ¢å¿…å­¦ |
| **ğŸ”¥ æœåŠ¡ç®¡ç†** | `service` | `æœåŠ¡æ§åˆ¶` | â­â­â­â­â­ | ğŸŸ¢å¿…å­¦ |
| **ğŸŸ¡ ç³»ç»Ÿç®¡ç†** | `user` | `ç”¨æˆ·ç®¡ç†` | â­â­â­â­ | ğŸŸ¡é‡è¦ |
| **ğŸŸ¡ é…ç½®ç®¡ç†** | `template` | `é…ç½®æ–‡ä»¶ç”Ÿæˆ` | â­â­â­â­ | ğŸŸ¡é‡è¦ |
| **ğŸŸ¡ ç½‘ç»œå·¥å…·** | `uri` | `HTTPè¯·æ±‚` | â­â­â­ | ğŸŸ è¿›é˜¶ |
| **ğŸŸ  äº‘å¹³å°** | `ec2` | `AWSèµ„æºç®¡ç†` | â­â­ | ğŸŸ è¿›é˜¶ |

### 2.3 æ¨¡å—çš„é€šç”¨å‚æ•°


**âš™ï¸ æ‰€æœ‰æ¨¡å—å…±äº«çš„å‚æ•°**

```yaml
# è¿™äº›å‚æ•°é€‚ç”¨äºæ‰€æœ‰æ¨¡å—
- name: æ¨¡å—ä½¿ç”¨ç¤ºä¾‹
  module_name:
    # æ¨¡å—ç‰¹å®šå‚æ•°...
    parameter: value
  # é€šç”¨å‚æ•°
  become: yes              # ææƒæ‰§è¡Œ
  become_user: root        # æŒ‡å®šææƒç”¨æˆ·
  ignore_errors: yes       # å¿½ç•¥é”™è¯¯ç»§ç»­æ‰§è¡Œ
  register: result         # ä¿å­˜æ‰§è¡Œç»“æœ
  when: condition          # æ¡ä»¶æ‰§è¡Œ
  tags: ['config']         # ç»™ä»»åŠ¡æ‰“æ ‡ç­¾
```

---

## 3. ğŸ“ æ–‡ä»¶æ“ä½œæ¨¡å—è¯¦è§£


### 3.1 copyæ¨¡å— - æ–‡ä»¶å¤åˆ¶åˆ©å™¨


**ğŸ“‹ copyæ¨¡å—åŸºç¡€åº”ç”¨**

> **copyæ¨¡å—ä½œç”¨**ï¼šæŠŠæ§åˆ¶èŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡ä¸»æœºï¼Œç›¸å½“äºscpå‘½ä»¤çš„å¢å¼ºç‰ˆï¼Œä½†æ›´æ™ºèƒ½æ›´å®‰å…¨ã€‚

```yaml
# åŸºç¡€æ–‡ä»¶å¤åˆ¶
- name: å¤åˆ¶é…ç½®æ–‡ä»¶
  copy:
    src: /local/nginx.conf          # æœ¬åœ°æºæ–‡ä»¶
    dest: /etc/nginx/nginx.conf     # ç›®æ ‡è·¯å¾„
    owner: root                     # æ–‡ä»¶æ‰€æœ‰è€…
    group: root                     # æ–‡ä»¶ç»„
    mode: '0644'                    # æ–‡ä»¶æƒé™
    backup: yes                     # å¤‡ä»½åŸæ–‡ä»¶
```

**ğŸ¯ copyæ¨¡å—é«˜çº§ç‰¹æ€§**

```yaml
# ç›´æ¥åˆ›å»ºæ–‡ä»¶å†…å®¹ï¼ˆä¸éœ€è¦æºæ–‡ä»¶ï¼‰
- name: åˆ›å»ºè„šæœ¬æ–‡ä»¶
  copy:
    content: |
      #!/bin/bash
      echo "Hello from Ansible"
      date
    dest: /tmp/hello.sh
    mode: '0755'

# å¤åˆ¶æ•´ä¸ªç›®å½•
- name: å¤åˆ¶ç½‘ç«™æ–‡ä»¶
  copy:
    src: /local/website/
    dest: /var/www/html/
    owner: apache
    group: apache
    mode: preserve              # ä¿æŒåŸæœ‰æƒé™
```

### 3.2 fileæ¨¡å— - æ–‡ä»¶å±æ€§ç®¡å®¶


**ğŸ”§ fileæ¨¡å—çš„å¤šç§ç”¨é€”**

```yaml
# åˆ›å»ºç›®å½•
- name: åˆ›å»ºåº”ç”¨ç›®å½•
  file:
    path: /opt/myapp
    state: directory
    owner: appuser
    group: appgroup
    mode: '0755'

# åˆ›å»ºç¬¦å·é“¾æ¥
- name: åˆ›å»ºé…ç½®æ–‡ä»¶é“¾æ¥
  file:
    src: /etc/myapp/config.yaml
    dest: /opt/myapp/config
    state: link

# åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•
- name: æ¸…ç†ä¸´æ—¶æ–‡ä»¶
  file:
    path: /tmp/oldfiles
    state: absent

# ä¿®æ”¹æ–‡ä»¶æƒé™
- name: è®¾ç½®æ—¥å¿—æ–‡ä»¶æƒé™
  file:
    path: /var/log/myapp.log
    owner: appuser
    group: appgroup
    mode: '0640'
```

### 3.3 templateæ¨¡å— - é…ç½®æ–‡ä»¶ç”Ÿæˆå™¨


**ğŸ“ templateæ¨¡å—çš„å¼ºå¤§åŠŸèƒ½**

> **templateæ¨¡å—**ï¼šå¯ä»¥æŠŠå¸¦æœ‰å˜é‡çš„æ¨¡æ¿æ–‡ä»¶æ¸²æŸ“æˆæœ€ç»ˆçš„é…ç½®æ–‡ä»¶ã€‚å°±åƒå¡«ç©ºé¢˜ä¸€æ ·ï¼Œæ¨¡æ¿æ˜¯é¢˜ç›®ï¼Œå˜é‡æ˜¯ç­”æ¡ˆã€‚

```yaml
# ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆé…ç½®æ–‡ä»¶
- name: ç”Ÿæˆnginxé…ç½®
  template:
    src: nginx.conf.j2              # æ¨¡æ¿æ–‡ä»¶ï¼ˆ.j2æ˜¯Jinja2æ¨¡æ¿ï¼‰
    dest: /etc/nginx/nginx.conf
    owner: root
    group: root
    mode: '0644'
    backup: yes
  notify: restart nginx             # é…ç½®å˜åŒ–æ—¶é‡å¯æœåŠ¡
```

**ğŸ¨ æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹ï¼ˆnginx.conf.j2ï¼‰**

```nginx
# Ansibleç”Ÿæˆçš„nginxé…ç½®
worker_processes {{ ansible_processor_vcpus }};

server {
    listen {{ nginx_port | default(80) }};
    server_name {{ server_name }};
    
    {% for location in nginx_locations %}
    location {{ location.path }} {
        proxy_pass {{ location.upstream }};
    }
    {% endfor %}
}
```

### 3.4 lineinfileæ¨¡å— - æ–‡ä»¶å†…å®¹ç¼–è¾‘å™¨


**âœï¸ lineinfileæ¨¡å—ç²¾å‡†ç¼–è¾‘**

```yaml
# ç¡®ä¿é…ç½®è¡Œå­˜åœ¨
- name: è®¾ç½®ç³»ç»Ÿå‚æ•°
  lineinfile:
    path: /etc/sysctl.conf
    line: 'net.ipv4.ip_forward=1'
    create: yes                     # æ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»º

# æ›¿æ¢åŒ¹é…çš„è¡Œ
- name: æ›´æ–°é…ç½®å‚æ•°
  lineinfile:
    path: /etc/myapp/config
    regexp: '^max_connections='
    line: 'max_connections=1000'

# åˆ é™¤åŒ¹é…çš„è¡Œ
- name: ç§»é™¤æ—§é…ç½®
  lineinfile:
    path: /etc/hosts
    regexp: '^.*old-server'
    state: absent
```

---

## 4. âš™ï¸ æœåŠ¡ç®¡ç†æ¨¡å—åº”ç”¨


### 4.1 serviceæ¨¡å— - é€šç”¨æœåŠ¡ç®¡ç†å™¨


**ğŸ® serviceæ¨¡å—åŸºç¡€æ“ä½œ**

> **serviceæ¨¡å—**ï¼šå°±åƒç³»ç»Ÿçš„æœåŠ¡ç®¡ç†å‘˜ï¼Œå¯ä»¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ï¼Œè¿˜èƒ½è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ã€‚

```yaml
# å¯åŠ¨æœåŠ¡
- name: å¯åŠ¨nginxæœåŠ¡
  service:
    name: nginx
    state: started
    enabled: yes              # å¼€æœºè‡ªå¯

# é‡å¯æœåŠ¡
- name: é‡å¯åº”ç”¨æœåŠ¡
  service:
    name: myapp
    state: restarted

# åœæ­¢æœåŠ¡
- name: åœæ­¢æ—§æœåŠ¡
  service:
    name: old-service
    state: stopped
    enabled: no               # ç¦ç”¨å¼€æœºè‡ªå¯
```

### 4.2 systemdæ¨¡å— - ç°ä»£æœåŠ¡ç®¡ç†


**ğŸ”„ systemdæ¨¡å—é«˜çº§åŠŸèƒ½**

```yaml
# systemdç‰¹æœ‰åŠŸèƒ½
- name: é‡æ–°åŠ è½½systemdé…ç½®
  systemd:
    daemon_reload: yes

# ç®¡ç†ç”¨æˆ·æœåŠ¡
- name: å¯åŠ¨ç”¨æˆ·æœåŠ¡
  systemd:
    name: user-app
    state: started
    scope: user
    
# ç®¡ç†æœåŠ¡çŠ¶æ€
- name: ç¡®ä¿æœåŠ¡è¿è¡Œ
  systemd:
    name: postgresql
    state: started
    enabled: yes
    masked: no                # ç¡®ä¿æœåŠ¡æœªè¢«å±è”½
```

### 4.3 docker_containeræ¨¡å— - å®¹å™¨æœåŠ¡ç®¡ç†


**ğŸ³ Dockerå®¹å™¨ç®¡ç†**

```yaml
# è¿è¡ŒDockerå®¹å™¨
- name: å¯åŠ¨Webåº”ç”¨å®¹å™¨
  docker_container:
    name: webapp
    image: nginx:latest
    state: started
    restart_policy: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - "/opt/webapp:/usr/share/nginx/html"
    env:
      ENV: production

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
- name: æ¸…ç†æ—§å®¹å™¨
  docker_container:
    name: old-webapp
    state: absent
```

---

## 5. ğŸ“¦ åŒ…ç®¡ç†æ¨¡å—ä½¿ç”¨


### 5.1 yumæ¨¡å— - RedHatç³»åŒ…ç®¡ç†


**ğŸ“¥ yumæ¨¡å—å¸¸ç”¨æ“ä½œ**

> **åŒ…ç®¡ç†æ¨¡å—**ï¼šå°±åƒæ‰‹æœºçš„åº”ç”¨å•†åº—ï¼Œå¯ä»¥å®‰è£…ã€å¸è½½ã€æ›´æ–°è½¯ä»¶åŒ…ï¼Œè¿˜èƒ½ç®¡ç†è½¯ä»¶ä»“åº“ã€‚

```yaml
# å®‰è£…å•ä¸ªè½¯ä»¶åŒ…
- name: å®‰è£…nginx
  yum:
    name: nginx
    state: present            # presentè¡¨ç¤ºå·²å®‰è£…

# å®‰è£…å¤šä¸ªè½¯ä»¶åŒ…
- name: å®‰è£…å¼€å‘å·¥å…·
  yum:
    name:
      - git
      - wget
      - curl
      - vim
    state: present

# å®‰è£…æŒ‡å®šç‰ˆæœ¬
- name: å®‰è£…ç‰¹å®šç‰ˆæœ¬Python
  yum:
    name: python3-3.8.0
    state: present

# æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ…
- name: ç³»ç»Ÿæ›´æ–°
  yum:
    name: '*'
    state: latest
    update_cache: yes         # æ›´æ–°ç¼“å­˜
```

### 5.2 aptæ¨¡å— - Debianç³»åŒ…ç®¡ç†


**ğŸ”§ aptæ¨¡å—åº”ç”¨ç¤ºä¾‹**

```yaml
# Ubuntu/Debianè½¯ä»¶åŒ…ç®¡ç†
- name: æ›´æ–°åŒ…ç¼“å­˜
  apt:
    update_cache: yes
    cache_valid_time: 3600    # ç¼“å­˜æœ‰æ•ˆæœŸ1å°æ—¶

- name: å®‰è£…è½¯ä»¶åŒ…
  apt:
    name:
      - nginx
      - mysql-server
      - php-fpm
    state: present

# ä»debæ–‡ä»¶å®‰è£…
- name: å®‰è£…æœ¬åœ°debåŒ…
  apt:
    deb: /tmp/mypackage.deb
```

### 5.3 pipæ¨¡å— - PythonåŒ…ç®¡ç†


**ğŸ PythonåŒ…ç®¡ç†**

```yaml
# å®‰è£…PythonåŒ…
- name: å®‰è£…Pythonä¾èµ–
  pip:
    name:
      - django==3.2
      - requests
      - psycopg2-binary
    virtualenv: /opt/myapp/venv
    virtualenv_python: python3.8

# ä»requirements.txtå®‰è£…
- name: å®‰è£…é¡¹ç›®ä¾èµ–
  pip:
    requirements: /opt/myapp/requirements.txt
    virtualenv: /opt/myapp/venv
```

---

## 6. ğŸŒ ç½‘ç»œé…ç½®æ¨¡å—å®è·µ


### 6.1 uriæ¨¡å— - HTTPå®¢æˆ·ç«¯


**ğŸ“¡ uriæ¨¡å—ç½‘ç»œæ“ä½œ**

> **uriæ¨¡å—**ï¼šåƒæµè§ˆå™¨ä¸€æ ·å¯ä»¥å‘é€HTTPè¯·æ±‚ï¼Œæ£€æŸ¥ç½‘ç«™çŠ¶æ€ã€è°ƒç”¨APIã€ä¸‹è½½æ–‡ä»¶ç­‰ã€‚

```yaml
# å¥åº·æ£€æŸ¥
- name: æ£€æŸ¥æœåŠ¡çŠ¶æ€
  uri:
    url: "http://{{ inventory_hostname }}:8080/health"
    method: GET
    status_code: 200
  register: health_check

# APIè°ƒç”¨
- name: è°ƒç”¨é‡å¯API
  uri:
    url: "https://api.example.com/restart"
    method: POST
    headers:
      Authorization: "Bearer {{ api_token }}"
      Content-Type: "application/json"
    body_format: json
    body:
      service: "webapp"
      force: true
```

### 6.2 get_urlæ¨¡å— - æ–‡ä»¶ä¸‹è½½å™¨


**â¬‡ï¸ ç½‘ç»œæ–‡ä»¶ä¸‹è½½**

```yaml
# ä¸‹è½½æ–‡ä»¶
- name: ä¸‹è½½åº”ç”¨ç¨‹åº
  get_url:
    url: "https://releases.example.com/app-v1.0.tar.gz"
    dest: /tmp/app-v1.0.tar.gz
    mode: '0755'
    checksum: "sha256:abc123..."  # æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§

# ä¸‹è½½å¹¶è§£å‹
- name: ä¸‹è½½é…ç½®æ–‡ä»¶
  get_url:
    url: "https://config.example.com/nginx.conf"
    dest: /etc/nginx/nginx.conf
    owner: root
    group: root
    mode: '0644'
    backup: yes
```

### 6.3 firewalldæ¨¡å— - é˜²ç«å¢™ç®¡ç†


**ğŸ”¥ é˜²ç«å¢™é…ç½®ç®¡ç†**

```yaml
# å¼€æ”¾ç«¯å£
- name: å¼€æ”¾WebæœåŠ¡ç«¯å£
  firewalld:
    port: "80/tcp"
    permanent: yes
    state: enabled
    immediate: yes            # ç«‹å³ç”Ÿæ•ˆ

# å¼€æ”¾æœåŠ¡
- name: å…è®¸SSHæœåŠ¡
  firewalld:
    service: ssh
    permanent: yes
    state: enabled

# æ·»åŠ å¯Œè§„åˆ™
- name: é™åˆ¶ç‰¹å®šIPè®¿é—®
  firewalld:
    rich_rule: 'rule family="ipv4" source address="192.168.1.100" port protocol="tcp" port="22" accept'
    permanent: yes
    state: enabled
```

---

## 7. â˜ï¸ äº‘å¹³å°æ¨¡å—é›†æˆ


### 7.1 ec2æ¨¡å— - AWSèµ„æºç®¡ç†


**ğŸš€ AWS EC2å®ä¾‹ç®¡ç†**

> **äº‘å¹³å°æ¨¡å—**ï¼šå¯ä»¥åƒæ§åˆ¶æœ¬åœ°æœåŠ¡å™¨ä¸€æ ·ç®¡ç†äº‘æœåŠ¡å™¨ï¼Œåˆ›å»ºã€åˆ é™¤ã€é…ç½®äº‘èµ„æºã€‚

```yaml
# åˆ›å»ºEC2å®ä¾‹
- name: å¯åŠ¨WebæœåŠ¡å™¨
  ec2:
    key_name: mykey
    instance_type: t2.micro
    image: ami-12345678
    wait: yes
    group: webservers
    count: 2
    vpc_subnet_id: subnet-12345
    assign_public_ip: yes
    instance_tags:
      Name: "WebServer"
      Environment: "Production"
```

### 7.2 azure_rmæ¨¡å— - Azureèµ„æºç®¡ç†


**â˜ï¸ Azureè™šæ‹Ÿæœºç®¡ç†**

```yaml
# åˆ›å»ºAzureè™šæ‹Ÿæœº
- name: åˆ›å»ºAzure VM
  azure_rm_virtualmachine:
    resource_group: myResourceGroup
    name: myVM
    vm_size: Standard_B1s
    admin_username: azureuser
    ssh_password_enabled: false
    ssh_public_keys:
      - path: /home/azureuser/.ssh/authorized_keys
        key_data: "{{ ssh_public_key }}"
    image:
      offer: UbuntuServer
      publisher: Canonical
      sku: '18.04-LTS'
      version: latest
```

---

## 8. ğŸ› ï¸ è‡ªå®šä¹‰æ¨¡å—å¼€å‘åŸºç¡€


### 8.1 è‡ªå®šä¹‰æ¨¡å—çš„åº”ç”¨åœºæ™¯


**ğŸ¯ ä½•æ—¶éœ€è¦è‡ªå®šä¹‰æ¨¡å—**

> **è‡ªå®šä¹‰æ¨¡å—**ï¼šå½“ç°æœ‰æ¨¡å—æ— æ³•æ»¡è¶³ç‰¹æ®Šéœ€æ±‚æ—¶ï¼Œå¯ä»¥å¼€å‘ä¸“å±æ¨¡å—ã€‚å°±åƒä¹°ä¸åˆ°åˆé€‚çš„å·¥å…·æ—¶è‡ªå·±åˆ¶ä½œã€‚

| **åœºæ™¯** | **è¯´æ˜** | **ç¤ºä¾‹** |
|---------|---------|---------|
| **ç‰¹æ®Šç³»ç»Ÿ** | `å†…éƒ¨ç³»ç»ŸAPIè°ƒç”¨` | `ä¼ä¸šå†…éƒ¨ç›‘æ§ç³»ç»Ÿ` |
| **å¤æ‚é€»è¾‘** | `å¤šæ­¥éª¤åŸå­æ“ä½œ` | `æ•°æ®åº“å¤‡ä»½+éªŒè¯+æ¸…ç†` |
| **æ€§èƒ½éœ€æ±‚** | `æ‰¹é‡æ“ä½œä¼˜åŒ–` | `å¤§é‡æ–‡ä»¶å¤„ç†` |
| **ä¸šåŠ¡é€»è¾‘** | `ç‰¹å®šä¸šåŠ¡æµç¨‹` | `åº”ç”¨å‘å¸ƒæµç¨‹` |

### 8.2 ç®€å•è‡ªå®šä¹‰æ¨¡å—ç¤ºä¾‹


**ğŸ“ Pythonæ¨¡å—å¼€å‘åŸºç¡€**

```python
#!/usr/bin/python

from ansible.module_utils.basic import AnsibleModule

def main():
    # å®šä¹‰æ¨¡å—å‚æ•°
    module = AnsibleModule(
        argument_spec=dict(
            name=dict(type='str', required=True),
            state=dict(type='str', default='present', 
                      choices=['present', 'absent']),
        ),
        supports_check_mode=True
    )
    
    name = module.params['name']
    state = module.params['state']
    
    # å®ç°æ¨¡å—é€»è¾‘
    if state == 'present':
        # æ‰§è¡Œåˆ›å»ºæ“ä½œ
        result = {'changed': True, 'msg': f'Created {name}'}
    else:
        # æ‰§è¡Œåˆ é™¤æ“ä½œ
        result = {'changed': True, 'msg': f'Removed {name}'}
    
    module.exit_json(**result)

if __name__ == '__main__':
    main()
```

### 8.3 æ¨¡å—å¼€å‘æœ€ä½³å®è·µ


**âœ… å¼€å‘è§„èŒƒæŒ‡å—**

```yaml
# æ¨¡å—ç›®å½•ç»“æ„
library/
â”œâ”€â”€ my_custom_module.py          # æ¨¡å—ä¸»æ–‡ä»¶
â”œâ”€â”€ module_utils/
â”‚   â””â”€â”€ my_helper.py             # è¾…åŠ©å‡½æ•°
â””â”€â”€ test_modules/
    â””â”€â”€ test_my_module.py        # æµ‹è¯•æ–‡ä»¶

# æ¨¡å—ä½¿ç”¨ç¤ºä¾‹
- name: ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—
  my_custom_module:
    name: "test-resource"
    state: present
    config:
      option1: value1
      option2: value2
  register: result
```

---

## 9. ğŸ“š æ¨¡å—æ–‡æ¡£æŸ¥è¯¢æ–¹æ³•


### 9.1 å†…ç½®æ–‡æ¡£æŸ¥è¯¢


**ğŸ” ansible-docå‘½ä»¤ä½¿ç”¨**

```bash
# æŸ¥çœ‹æ¨¡å—åˆ—è¡¨
ansible-doc -l | grep file

# æŸ¥çœ‹æ¨¡å—è¯¦ç»†æ–‡æ¡£
ansible-doc copy

# æŸ¥çœ‹æ¨¡å—ç¤ºä¾‹
ansible-doc -s yum

# æœç´¢ç‰¹å®šåŠŸèƒ½æ¨¡å—
ansible-doc -l | grep -i network
```

### 9.2 åœ¨çº¿æ–‡æ¡£èµ„æº


**ğŸ“– å®˜æ–¹æ–‡æ¡£ä½ç½®**

| **èµ„æºç±»å‹** | **ç½‘å€** | **ç‰¹ç‚¹** |
|-------------|----------|---------|
| **å®˜æ–¹æ¨¡å—ç´¢å¼•** | `docs.ansible.com/modules` | `æœ€æƒå¨å®Œæ•´` |
| **ç¤¾åŒºè´¡çŒ®** | `galaxy.ansible.com` | `ç¬¬ä¸‰æ–¹æ¨¡å—` |
| **GitHubæºç ** | `github.com/ansible/ansible` | `æœ€æ–°å¼€å‘ç‰ˆæœ¬` |

### 9.3 æ¨¡å—ä¿¡æ¯è·å–æŠ€å·§


**ğŸ’¡ å¿«é€Ÿè·å–æ¨¡å—ä¿¡æ¯**

```yaml
# åœ¨Playbookä¸­è·å–æ¨¡å—ä¿¡æ¯
- name: æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
  debug:
    var: ansible_facts

- name: æ¨¡å—æ‰§è¡Œç»“æœ
  yum:
    name: nginx
    state: present
  register: install_result

- name: æ˜¾ç¤ºå®‰è£…ç»“æœ
  debug:
    msg: "å®‰è£…çŠ¶æ€: {{ install_result.changed }}"
```

**ğŸ”§ è°ƒè¯•æ¨¡å—æ‰§è¡Œ**

```bash
# è¯¦ç»†æ‰§è¡Œæ—¥å¿—
ansible-playbook -vvv site.yml

# æ£€æŸ¥æ¨¡å¼ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
ansible-playbook --check site.yml

# è¯­æ³•æ£€æŸ¥
ansible-playbook --syntax-check site.yml
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¨¡å—æœ¬è´¨ï¼šAnsibleçš„å·¥å…·ç®±ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šä»»åŠ¡
ğŸ”¸ å¹‚ç­‰æ€§ï¼šå¤šæ¬¡æ‰§è¡Œç»“æœä¸€è‡´ï¼Œä¸ä¼šé‡å¤æ“ä½œ
ğŸ”¸ æ–‡ä»¶æ“ä½œï¼šcopyã€fileã€templateã€lineinfileå››å¤§æ ¸å¿ƒ
ğŸ”¸ æœåŠ¡ç®¡ç†ï¼šservice/systemdç®¡ç†ç³»ç»ŸæœåŠ¡ç”Ÿå‘½å‘¨æœŸ
ğŸ”¸ åŒ…ç®¡ç†ï¼šyum/apt/pipç®¡ç†ä¸åŒç±»å‹è½¯ä»¶åŒ…
ğŸ”¸ ç½‘ç»œæ¨¡å—ï¼šuriã€get_urlå¤„ç†HTTPè¯·æ±‚å’Œæ–‡ä»¶ä¸‹è½½
ğŸ”¸ äº‘å¹³å°ï¼šec2ã€azure_rmç­‰ç®¡ç†äº‘èµ„æº
ğŸ”¸ æ–‡æ¡£æŸ¥è¯¢ï¼šansible-docæ˜¯æœ€å¥½çš„å­¦ä¹ å·¥å…·
```

### 10.2 æ¨¡å—é€‰æ‹©ç­–ç•¥


**ğŸ¯ å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ¨¡å—**

```
é€‰æ‹©æ¨¡å—çš„æ€è€ƒæµç¨‹ï¼š

æˆ‘è¦åšä»€ä¹ˆï¼Ÿ
    â†“
æŸ¥çœ‹æ˜¯å¦æœ‰ä¸“ç”¨æ¨¡å—
    â†“
ä¸“ç”¨æ¨¡å— â†’ ä¼˜å…ˆä½¿ç”¨ä¸“ç”¨æ¨¡å—
é€šç”¨æ¨¡å— â†’ ä½¿ç”¨shell/commandæ¨¡å—
    â†“
æµ‹è¯•å’ŒéªŒè¯åŠŸèƒ½
    â†“
ç¼–å†™å¯ç»´æŠ¤çš„Playbook
```

**ğŸ“Š æ¨¡å—ä½¿ç”¨ä¼˜å…ˆçº§**

| **ä¼˜å…ˆçº§** | **æ¨¡å—ç±»å‹** | **åŸå› ** | **ç¤ºä¾‹** |
|-----------|-------------|---------|---------|
| **ğŸ¥‡ æœ€é«˜** | `ä¸“ç”¨æ¨¡å—` | `åŠŸèƒ½å®Œæ•´ã€é”™è¯¯å¤„ç†å¥½` | `yumå®‰è£…è½¯ä»¶vs shellæ‰§è¡Œyum` |
| **ğŸ¥ˆ è¾ƒé«˜** | `é€šç”¨æ¨¡å—` | `è·¨å¹³å°å…¼å®¹æ€§å¥½` | `fileåˆ›å»ºç›®å½•vs shell mkdir` |
| **ğŸ¥‰ è¾ƒä½** | `shell/command` | `å¤æ‚é€»è¾‘ã€ç‰¹æ®Šéœ€æ±‚` | `å¤æ‚çš„æ–‡æœ¬å¤„ç†` |

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ ä¼ä¸šçº§åº”ç”¨å»ºè®®**

```yaml
# æ¨èçš„æ¨¡å—ç»„åˆä½¿ç”¨æ¨¡å¼
---
- name: WebæœåŠ¡å™¨é…ç½®æ ‡å‡†æµç¨‹
  hosts: webservers
  tasks:
    # 1. åŒ…ç®¡ç† - å®‰è£…è½¯ä»¶
    - name: å®‰è£…WebæœåŠ¡å™¨
      yum:
        name: ['nginx', 'php-fpm']
        state: present
        
    # 2. æ–‡ä»¶ç®¡ç† - éƒ¨ç½²é…ç½®
    - name: éƒ¨ç½²é…ç½®æ–‡ä»¶
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
      notify: restart nginx
      
    # 3. æœåŠ¡ç®¡ç† - å¯åŠ¨æœåŠ¡
    - name: å¯åŠ¨WebæœåŠ¡
      service:
        name: nginx
        state: started
        enabled: yes
        
    # 4. ç½‘ç»œæ£€æŸ¥ - éªŒè¯éƒ¨ç½²
    - name: æ£€æŸ¥æœåŠ¡çŠ¶æ€
      uri:
        url: "http://{{ inventory_hostname }}"
        status_code: 200
```

**âš ï¸ å¸¸è§ä½¿ç”¨è¯¯åŒº**

| **é”™è¯¯åšæ³•** | **æ­£ç¡®åšæ³•** | **è¯´æ˜** |
|-------------|-------------|---------|
| `è¿‡åº¦ä½¿ç”¨shellæ¨¡å—` | `ä¼˜å…ˆä½¿ç”¨ä¸“ç”¨æ¨¡å—` | `ä¸“ç”¨æ¨¡å—æ›´å¯é ` |
| `å¿½ç•¥æ¨¡å—è¿”å›å€¼` | `registerç»“æœå¹¶å¤„ç†` | `ä¾¿äºè°ƒè¯•å’Œæµç¨‹æ§åˆ¶` |
| `ä¸è®¾ç½®å¹‚ç­‰æ€§æ£€æŸ¥` | `åˆç†ä½¿ç”¨whenæ¡ä»¶` | `é¿å…é‡å¤æ‰§è¡Œ` |
| `ç¡¬ç¼–ç å‚æ•°å€¼` | `ä½¿ç”¨å˜é‡å’Œæ¨¡æ¿` | `æé«˜å¯ç»´æŠ¤æ€§` |

### 10.4 è¿›é˜¶å­¦ä¹ è·¯å¾„


**ğŸ“ æ¨¡å—å­¦ä¹ è¿›é˜¶å»ºè®®**

```
å­¦ä¹ é˜¶æ®µè§„åˆ’ï¼š

ğŸŸ¢ åŸºç¡€é˜¶æ®µï¼ˆå¿…å­¦ï¼‰ï¼š
â”œâ”€ ping, copy, file, service
â”œâ”€ yum/apt, user, group
â””â”€ shell, commandåŸºç¡€ç”¨æ³•

ğŸŸ¡ è¿›é˜¶é˜¶æ®µï¼ˆé‡è¦ï¼‰ï¼š
â”œâ”€ template, lineinfileé…ç½®ç®¡ç†
â”œâ”€ uri, get_urlç½‘ç»œæ“ä½œ
â””â”€ docker_containerå®¹å™¨ç®¡ç†

ğŸŸ  é«˜çº§é˜¶æ®µï¼ˆæ‰©å±•ï¼‰ï¼š
â”œâ”€ äº‘å¹³å°æ¨¡å—(ec2, azure_rm)
â”œâ”€ æ•°æ®åº“æ¨¡å—(mysql_user, postgresql_db)
â””â”€ è‡ªå®šä¹‰æ¨¡å—å¼€å‘
```

**ğŸ”§ å®è·µå»ºè®®**

1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆç”¨pingæ¨¡å—æµ‹è¯•è¿æ¥
2. **é€æ­¥å¤æ‚**ï¼šä»copyæ–‡ä»¶åˆ°templateé…ç½®
3. **ç»„åˆä½¿ç”¨**ï¼šå¤šä¸ªæ¨¡å—é…åˆå®Œæˆå¤æ‚ä»»åŠ¡  
4. **æ–‡æ¡£ä¸ºå‡†**ï¼šé‡åˆ°é—®é¢˜å…ˆæŸ¥ansible-doc
5. **æµ‹è¯•éªŒè¯**ï¼šä½¿ç”¨--checkæ¨¡å¼éªŒè¯æ“ä½œ

**æ ¸å¿ƒè®°å¿†**ï¼š
```
æ¨¡å—é€‰æ‹©æœ‰é—¨é“ï¼Œä¸“ç”¨ä¼˜äºé€šç”¨å¥½
æ–‡ä»¶æœåŠ¡åŒ…ç®¡ç†ï¼Œç½‘ç»œäº‘ç«¯å…¨è¦†ç›–
å¹‚ç­‰å®‰å…¨æ˜¯åŸºç¡€ï¼Œæ–‡æ¡£æŸ¥è¯¢è¦è®°ç‰¢
ç»„åˆä½¿ç”¨è§£éš¾é¢˜ï¼Œå®è·µå‡ºçœŸçŸ¥æ›´å¦™
```