---
title: 10ã€æœåŠ¡å¯åŠ¨å¤±è´¥å¤„ç†
---
## ğŸ“š ç›®å½•

1. [æœåŠ¡å¯åŠ¨å¤±è´¥æ¦‚è¿°](#1-æœåŠ¡å¯åŠ¨å¤±è´¥æ¦‚è¿°)
2. [systemdæœåŠ¡å¯åŠ¨å¤±è´¥åˆ†æ](#2-systemdæœåŠ¡å¯åŠ¨å¤±è´¥åˆ†æ)
3. [æœåŠ¡ä¾èµ–å…³ç³»é”™è¯¯](#3-æœåŠ¡ä¾èµ–å…³ç³»é”™è¯¯)
4. [é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥](#4-é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥)
5. [ç«¯å£å ç”¨å¯¼è‡´å¯åŠ¨å¤±è´¥](#5-ç«¯å£å ç”¨å¯¼è‡´å¯åŠ¨å¤±è´¥)
6. [ç”¨æˆ·æƒé™ä¸è¶³é—®é¢˜](#6-ç”¨æˆ·æƒé™ä¸è¶³é—®é¢˜)
7. [ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯](#7-ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯)
8. [æœåŠ¡æ–‡ä»¶è·¯å¾„é—®é¢˜](#8-æœåŠ¡æ–‡ä»¶è·¯å¾„é—®é¢˜)
9. [æœåŠ¡è¶…æ—¶é…ç½®è°ƒæ•´](#9-æœåŠ¡è¶…æ—¶é…ç½®è°ƒæ•´)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ æœåŠ¡å¯åŠ¨å¤±è´¥æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡å¯åŠ¨å¤±è´¥


**ç®€å•ç†è§£**ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥å°±åƒä½ æƒ³å‘åŠ¨æ±½è½¦ï¼Œä½†æ€ä¹ˆè½¬é’¥åŒ™éƒ½å¯åŠ¨ä¸äº†ã€‚å¯èƒ½æ˜¯æ²¡æ²¹äº†ã€ç”µç“¶æ²¡ç”µã€å¼•æ“æœ‰é—®é¢˜ï¼Œæˆ–è€…é’¥åŒ™ä¸å¯¹ã€‚

åœ¨Linuxç³»ç»Ÿä¸­ï¼ŒæœåŠ¡å¯åŠ¨å¤±è´¥é€šå¸¸è¡¨ç°ä¸ºï¼š
- æ‰§è¡Œ `systemctl start service-name` åæŠ¥é”™
- æœåŠ¡çŠ¶æ€æ˜¾ç¤ºä¸º **failed** æˆ– **inactive**
- ç³»ç»Ÿæ—¥å¿—ä¸­å‡ºç°é”™è¯¯ä¿¡æ¯
- åº”ç”¨ç¨‹åºæ— æ³•æ­£å¸¸æä¾›åŠŸèƒ½

### 1.2 æœåŠ¡å¯åŠ¨å¤±è´¥çš„å¸¸è§ç—‡çŠ¶


**ğŸ” å…¸å‹è¡¨ç°**ï¼š

```
ç³»ç»Ÿæç¤ºä¿¡æ¯ï¼š
âŒ Job for apache2.service failed because the control process exited with error code.
âŒ Failed to start Apache HTTP Server.
âŒ Unit apache2.service entered failed state.
âŒ apache2.service: Main process exited, code=exited, status=1/FAILURE
```

**ğŸ“Š æ•…éšœä¸¥é‡ç¨‹åº¦åˆ†ç±»**ï¼š

| ä¸¥é‡ç¨‹åº¦ | **è¡¨ç°** | **å½±å“** | **ç´§æ€¥ç¨‹åº¦** |
|---------|----------|---------|-------------|
| ğŸŸ¢ **è½»å¾®** | `æœåŠ¡å»¶è¿Ÿå¯åŠ¨` | `åŠŸèƒ½çŸ­æš‚ä¸å¯ç”¨` | `å¯è®¡åˆ’å¤„ç†` |
| ğŸŸ¡ **ä¸­ç­‰** | `æœåŠ¡å¯åŠ¨å¤±è´¥ä½†ç³»ç»Ÿç¨³å®š` | `ç‰¹å®šåŠŸèƒ½ä¸å¯ç”¨` | `éœ€åŠæ—¶å¤„ç†` |
| ğŸŸ  **ä¸¥é‡** | `å…³é”®æœåŠ¡å¯åŠ¨å¤±è´¥` | `ç³»ç»ŸåŠŸèƒ½å—æŸ` | `ç«‹å³å¤„ç†` |
| ğŸ”´ **è‡´å‘½** | `ç³»ç»ŸæœåŠ¡å¯åŠ¨å¤±è´¥å¯¼è‡´æ— æ³•å¯åŠ¨` | `ç³»ç»Ÿæ— æ³•ä½¿ç”¨` | `ç´§æ€¥å¤„ç†` |

### 1.3 æ•…éšœè¯Šæ–­çš„åŸºæœ¬æ€è·¯


**ğŸ§  è¯Šæ–­æ€ç»´æ¨¡å‹**ï¼š
```
æ•…éšœè¯Šæ–­æµç¨‹ï¼š
é—®é¢˜å‘ç° â†’ ä¿¡æ¯æ”¶é›† â†’ åŸå› åˆ†æ â†’ è§£å†³æ–¹æ¡ˆ â†’ éªŒè¯ç»“æœ

å…·ä½“æ­¥éª¤ï¼š
1. ç¡®è®¤æ•…éšœç°è±¡ï¼šæœåŠ¡çœŸçš„å¯åŠ¨å¤±è´¥äº†å—ï¼Ÿ
2. æ”¶é›†é”™è¯¯ä¿¡æ¯ï¼šæŸ¥çœ‹æ—¥å¿—å’ŒçŠ¶æ€ä¿¡æ¯
3. åˆ†æå¯èƒ½åŸå› ï¼šä¾èµ–ã€é…ç½®ã€æƒé™ã€èµ„æºç­‰
4. é€ä¸€æ’æŸ¥éªŒè¯ï¼šä»æœ€å¯èƒ½çš„åŸå› å¼€å§‹
5. å®æ–½è§£å†³æ–¹æ¡ˆï¼šä¿®å¤é—®é¢˜
6. éªŒè¯ä¿®å¤æ•ˆæœï¼šç¡®ä¿é—®é¢˜çœŸæ­£è§£å†³
```

---

## 2. âš™ï¸ systemdæœåŠ¡å¯åŠ¨å¤±è´¥åˆ†æ


### 2.1 systemdæœåŠ¡ç®¡ç†åŸºç¡€


**ä»€ä¹ˆæ˜¯systemdï¼Ÿ**
systemdå°±åƒæ˜¯Linuxç³»ç»Ÿçš„"æ€»ç®¡å®¶"ï¼Œè´Ÿè´£å¯åŠ¨ã€åœæ­¢ã€ç›‘æ§æ‰€æœ‰ç³»ç»ŸæœåŠ¡ã€‚å½“æœåŠ¡å¯åŠ¨å¤±è´¥æ—¶ï¼Œsystemdä¼šè®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å¸®æˆ‘ä»¬è¯Šæ–­é—®é¢˜ã€‚

**ğŸ”§ åŸºæœ¬è¯Šæ–­å‘½ä»¤**ï¼š

```bash
# æŸ¥çœ‹æœåŠ¡å½“å‰çŠ¶æ€
systemctl status nginx

# æŸ¥çœ‹æœåŠ¡å¯åŠ¨å¤±è´¥çš„è¯¦ç»†ä¿¡æ¯
systemctl status nginx -l

# æŸ¥çœ‹æœåŠ¡çš„å¯åŠ¨æ—¥å¿—
journalctl -u nginx

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯æ—¥å¿—
journalctl -u nginx --since "10 minutes ago"
```

### 2.2 è§£è¯»systemdé”™è¯¯ä¿¡æ¯


**ğŸ“‹ å¸¸è§é”™è¯¯ä¿¡æ¯è§£è¯»**ï¼š

**é”™è¯¯ç±»å‹ä¸€ï¼šè¿›ç¨‹é€€å‡ºé”™è¯¯**
```
nginx.service: Main process exited, code=exited, status=1/FAILURE
```
**å«ä¹‰è§£é‡Š**ï¼š
- **Main process exited**ï¼šä¸»è¿›ç¨‹é€€å‡ºäº†
- **code=exited**ï¼šè¿›ç¨‹æ˜¯æ­£å¸¸é€€å‡ºçš„ï¼ˆä¸æ˜¯è¢«æ€æ­»ï¼‰
- **status=1**ï¼šé€€å‡ºç ä¸º1ï¼Œè¡¨ç¤ºæœ‰é”™è¯¯

**é”™è¯¯ç±»å‹äºŒï¼šå¯åŠ¨è¶…æ—¶**
```
nginx.service: Start operation timed out. Terminating.
```
**å«ä¹‰è§£é‡Š**ï¼š
- æœåŠ¡åœ¨è§„å®šæ—¶é—´å†…æ²¡æœ‰å¯åŠ¨æˆåŠŸ
- systemdå¼ºåˆ¶ç»ˆæ­¢äº†å¯åŠ¨è¿‡ç¨‹
- é€šå¸¸æ˜¯å¯åŠ¨æ—¶é—´è¿‡é•¿æˆ–é…ç½®æœ‰é—®é¢˜

**é”™è¯¯ç±»å‹ä¸‰ï¼šä¾èµ–å¤±è´¥**
```
nginx.service: Dependency failed for Web Server.
```
**å«ä¹‰è§£é‡Š**ï¼š
- æœåŠ¡æ‰€ä¾èµ–çš„å…¶ä»–æœåŠ¡å¯åŠ¨å¤±è´¥
- éœ€è¦å…ˆè§£å†³ä¾èµ–æœåŠ¡çš„é—®é¢˜

### 2.3 systemdæœåŠ¡çŠ¶æ€è¯¦è§£


**ğŸ” æœåŠ¡çŠ¶æ€å«ä¹‰**ï¼š

```
æœåŠ¡çŠ¶æ€å›¾ç¤ºï¼š
inactive/dead  â†’ loaded    â†’ active/running
     â†“              â†“             â†“
  å·²åœæ­¢        å·²åŠ è½½ä½†æœªè¿è¡Œ    æ­£åœ¨è¿è¡Œ
     
failed        â†’ å¯åŠ¨å¤±è´¥ï¼Œéœ€è¦æ’æŸ¥åŸå› 
activating    â†’ æ­£åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­
deactivating  â†’ æ­£åœ¨åœæ­¢è¿‡ç¨‹ä¸­
```

**ğŸ’¡ çŠ¶æ€æŸ¥çœ‹æŠ€å·§**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰å¤±è´¥çš„æœåŠ¡
systemctl --failed

# æŸ¥çœ‹æœåŠ¡çš„å®Œæ•´çŠ¶æ€ä¿¡æ¯
systemctl show nginx

# æŸ¥çœ‹æœåŠ¡é…ç½®æ–‡ä»¶
systemctl cat nginx

# é‡æ–°åŠ è½½æœåŠ¡é…ç½®
systemctl daemon-reload
```

### 2.4 systemdæ—¥å¿—åˆ†ææŠ€å·§


**ğŸ“ é«˜æ•ˆæ—¥å¿—æŸ¥çœ‹æ–¹æ³•**ï¼š

```bash
# åªçœ‹é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯
journalctl -u nginx -p err

# å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆç±»ä¼¼tail -fï¼‰
journalctl -u nginx -f

# æŸ¥çœ‹å¯åŠ¨ä»¥æ¥çš„æ‰€æœ‰æ—¥å¿—
journalctl -u nginx --since boot

# æŸ¥çœ‹æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—
journalctl -u nginx --since "2024-01-01" --until "2024-01-02"

# æŸ¥çœ‹æœ€æ–°çš„50æ¡æ—¥å¿—
journalctl -u nginx -n 50
```

**ğŸ¯ æ—¥å¿—åˆ†æè¦ç‚¹**ï¼š
- **æ—¶é—´åºåˆ—**ï¼šæŒ‰æ—¶é—´é¡ºåºæŸ¥çœ‹ï¼Œæ‰¾å‡ºé—®é¢˜å‘ç”Ÿçš„ç¡®åˆ‡æ—¶é—´
- **å…³é”®è¯è¿‡æ»¤**ï¼šæœç´¢"error"ã€"failed"ã€"cannot"ç­‰å…³é”®è¯
- **å…³è”åˆ†æ**ï¼šåŒæ—¶æŸ¥çœ‹ç›¸å…³æœåŠ¡çš„æ—¥å¿—
- **ä¸Šä¸‹æ–‡**ï¼šä¸åªçœ‹é”™è¯¯ä¿¡æ¯ï¼Œä¹Ÿè¦çœ‹å‰åçš„æ­£å¸¸æ—¥å¿—

---

## 3. ğŸ”— æœåŠ¡ä¾èµ–å…³ç³»é”™è¯¯


### 3.1 ç†è§£æœåŠ¡ä¾èµ–å…³ç³»


**ä»€ä¹ˆæ˜¯æœåŠ¡ä¾èµ–ï¼Ÿ**
å°±åƒåšèœéœ€è¦å…ˆæ´—èœã€åˆ‡èœï¼Œç„¶åæ‰èƒ½ä¸‹é”…ç‚’èœä¸€æ ·ï¼Œå¾ˆå¤šæœåŠ¡å¯åŠ¨ä¹Ÿæœ‰å…ˆåé¡ºåºã€‚æ¯”å¦‚WebæœåŠ¡å™¨å¯èƒ½éœ€è¦å…ˆå¯åŠ¨æ•°æ®åº“ï¼Œé‚®ä»¶æœåŠ¡å¯èƒ½éœ€è¦å…ˆå¯åŠ¨ç½‘ç»œæœåŠ¡ã€‚

**ğŸ”„ ä¾èµ–å…³ç³»ç±»å‹**ï¼š

```
ä¾èµ–ç±»å‹è¯´æ˜ï¼š
Requires= â†’ å¼ºä¾èµ–ï¼šå¿…é¡»å…ˆå¯åŠ¨ä¾èµ–æœåŠ¡
Wants=    â†’ å¼±ä¾èµ–ï¼šå¸Œæœ›ä¾èµ–æœåŠ¡å¯åŠ¨ï¼Œä½†ä¸å¼ºåˆ¶
After=    â†’ é¡ºåºä¾èµ–ï¼šåœ¨æŒ‡å®šæœåŠ¡ä¹‹åå¯åŠ¨
Before=   â†’ é¡ºåºä¾èµ–ï¼šåœ¨æŒ‡å®šæœåŠ¡ä¹‹å‰å¯åŠ¨

ç¤ºä¾‹å…³ç³»ï¼š
WebæœåŠ¡å™¨ --Requires--> ç½‘ç»œæœåŠ¡
WebæœåŠ¡å™¨ --After-----> ç½‘ç»œæœåŠ¡  
WebæœåŠ¡å™¨ --Wants-----> æ•°æ®åº“æœåŠ¡
```

### 3.2 è¯Šæ–­ä¾èµ–å…³ç³»é—®é¢˜


**ğŸ” ä¾èµ–é—®é¢˜æ’æŸ¥æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šæŸ¥çœ‹æœåŠ¡ä¾èµ–å…³ç³»**
```bash
# æŸ¥çœ‹æœåŠ¡çš„ä¾èµ–å…³ç³»
systemctl list-dependencies nginx

# æŸ¥çœ‹è°ä¾èµ–è¿™ä¸ªæœåŠ¡
systemctl list-dependencies nginx --reverse

# æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¾èµ–æ ‘
systemctl list-dependencies nginx --all
```

**æ­¥éª¤2ï¼šæ£€æŸ¥ä¾èµ–æœåŠ¡çŠ¶æ€**
```bash
# æ‰¹é‡æ£€æŸ¥ç›¸å…³æœåŠ¡çŠ¶æ€
systemctl status network.target
systemctl status multi-user.target
systemctl status mysql.service
```

**æ­¥éª¤3ï¼šåˆ†æä¾èµ–å¤±è´¥åŸå› **
```bash
# æŸ¥çœ‹å…·ä½“å“ªä¸ªä¾èµ–å¤±è´¥äº†
journalctl -u nginx | grep -i "dependency"

# æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¶çš„ä¾èµ–å…³ç³»
systemd-analyze critical-chain nginx.service
```

### 3.3 è§£å†³ä¾èµ–å…³ç³»é—®é¢˜


**ğŸ› ï¸ å¸¸è§è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ1ï¼šä¿®å¤å¤±è´¥çš„ä¾èµ–æœåŠ¡**
```bash
# å…ˆå¯åŠ¨å¤±è´¥çš„ä¾èµ–æœåŠ¡
systemctl start mysql.service

# å†å¯åŠ¨ç›®æ ‡æœåŠ¡
systemctl start nginx.service
```

**æ–¹æ¡ˆ2ï¼šè°ƒæ•´æœåŠ¡é…ç½®æ–‡ä»¶**
å¦‚æœä¾èµ–å…³ç³»é…ç½®ä¸å½“ï¼Œå¯ä»¥ä¿®æ”¹æœåŠ¡æ–‡ä»¶ï¼š
```ini
[Unit]
Description=My Web Service
# ç§»é™¤ä¸å¿…è¦çš„å¼ºä¾èµ–
# Requires=some-service.service
# æ”¹ä¸ºå¼±ä¾èµ–
Wants=some-service.service
After=network.target

[Service]
Type=forking
ExecStart=/usr/bin/my-web-service

[Install]
WantedBy=multi-user.target
```

**æ–¹æ¡ˆ3ï¼šåˆ›å»ºè‡ªå®šä¹‰å¯åŠ¨é¡ºåº**
```bash
# åˆ›å»ºè‡ªå®šä¹‰target
sudo systemctl edit my-services.target

# å†…å®¹ç¤ºä¾‹
[Unit]
Description=My Custom Services
Requires=mysql.service
After=mysql.service
```

### 3.4 ä¾èµ–å…³ç³»ä¼˜åŒ–å»ºè®®


**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
- **æœ€å°ä¾èµ–åŸåˆ™**ï¼šåªå®šä¹‰çœŸæ­£å¿…è¦çš„ä¾èµ–å…³ç³»
- **ä½¿ç”¨Wantsè€ŒéRequires**ï¼šé™¤éç»å¯¹å¿…è¦ï¼Œä¼˜å…ˆä½¿ç”¨å¼±ä¾èµ–
- **æ˜ç¡®å¯åŠ¨é¡ºåº**ï¼šä½¿ç”¨Afterå’ŒBeforeæ˜ç¡®æœåŠ¡å¯åŠ¨é¡ºåº
- **é¿å…å¾ªç¯ä¾èµ–**ï¼šç¡®ä¿æœåŠ¡é—´ä¸ä¼šå½¢æˆå¾ªç¯ä¾èµ–å…³ç³»

**âš ï¸ å¸¸è§é™·é˜±**ï¼š
```
é™·é˜±1ï¼šè¿‡åº¦ä¾èµ–
é”™è¯¯ï¼šè®©WebæœåŠ¡ä¾èµ–æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„æœåŠ¡
æ­£ç¡®ï¼šåªä¾èµ–æ ¸å¿ƒå¿…éœ€çš„æœåŠ¡

é™·é˜±2ï¼šå¾ªç¯ä¾èµ–
é”™è¯¯ï¼šAä¾èµ–Bï¼ŒBåˆä¾èµ–A
æ­£ç¡®ï¼šæ¢³ç†æ¸…æ¥šçœŸæ­£çš„ä¾èµ–å…³ç³»

é™·é˜±3ï¼šä¾èµ–ä¸å­˜åœ¨çš„æœåŠ¡
é”™è¯¯ï¼šä¾èµ–ä¸€ä¸ªæ‹¼å†™é”™è¯¯æˆ–ä¸å­˜åœ¨çš„æœåŠ¡å
æ­£ç¡®ï¼šä»”ç»†æ£€æŸ¥æœåŠ¡åç§°çš„æ­£ç¡®æ€§
```

---

## 4. ğŸ“ é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥


### 4.1 é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯çš„è¡¨ç°


**ä»€ä¹ˆæ˜¯é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ï¼Ÿ**
å°±åƒå†™ä½œæ–‡æ—¶æ ‡ç‚¹ç¬¦å·ç”¨é”™äº†ï¼Œæˆ–è€…å•è¯æ‹¼é”™äº†ï¼Œç¨‹åºè¯»ä¸æ‡‚é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œè‡ªç„¶å°±å¯åŠ¨ä¸äº†ã€‚

**ğŸš¨ å…¸å‹è¯­æ³•é”™è¯¯ç—‡çŠ¶**ï¼š
```
é”™è¯¯ä¿¡æ¯ç¤ºä¾‹ï¼š
âŒ Configuration file syntax error
âŒ Invalid configuration directive
âŒ Unexpected token in configuration file
âŒ Missing semicolon or bracket
âŒ Unknown parameter in config file
```

### 4.2 ä¸åŒæœåŠ¡çš„é…ç½®æ–‡ä»¶æ£€æŸ¥


**ğŸ”§ Apacheé…ç½®æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥Apacheé…ç½®è¯­æ³•
sudo apache2ctl configtest
# æˆ–è€…
sudo apachectl -t

# æŸ¥çœ‹é…ç½®æ–‡ä»¶ä½ç½®
apache2ctl -S

# æ£€æŸ¥ç‰¹å®šé…ç½®æ–‡ä»¶
sudo apache2ctl -t -f /path/to/config/file
```

**ğŸŒ Nginxé…ç½®æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥Nginxé…ç½®è¯­æ³•
sudo nginx -t

# æ£€æŸ¥å¹¶æ˜¾ç¤ºé…ç½®æ–‡ä»¶å†…å®¹
sudo nginx -T

# é‡æ–°åŠ è½½é…ç½®ï¼ˆè¯­æ³•æ­£ç¡®æ—¶ï¼‰
sudo nginx -s reload
```

**ğŸ—„ï¸ MySQLé…ç½®æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥MySQLé…ç½®æ–‡ä»¶
sudo mysqld --help --verbose | head -20

# ä½¿ç”¨my_print_defaultsæŸ¥çœ‹é…ç½®
my_print_defaults mysqld

# å¯åŠ¨æ—¶éªŒè¯é…ç½®
sudo mysqld --validate-config
```

### 4.3 é€šç”¨é…ç½®æ–‡ä»¶æ£€æŸ¥æ–¹æ³•


**ğŸ“‹ ç³»ç»Ÿçº§æ£€æŸ¥å·¥å…·**ï¼š

```bash
# ä½¿ç”¨systemdæ£€æŸ¥æœåŠ¡é…ç½®
systemd-analyze verify myservice.service

# æ£€æŸ¥systemdæœåŠ¡æ–‡ä»¶è¯­æ³•
systemctl daemon-reload
# å¦‚æœæœ‰è¯­æ³•é”™è¯¯ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šæŠ¥é”™

# æŸ¥çœ‹æœåŠ¡é…ç½®æ–‡ä»¶
systemctl cat myservice.service
```

**ğŸ” æ‰‹åŠ¨è¯­æ³•æ£€æŸ¥æŠ€å·§**ï¼š

**æŠ€å·§1ï¼šåˆ†æ®µæ³¨é‡Šæ³•**
å½“é…ç½®æ–‡ä»¶å¾ˆé•¿ï¼Œé”™è¯¯ä½ç½®ä¸æ˜ç¡®æ—¶ï¼š
```bash
# å¤‡ä»½åŸé…ç½®æ–‡ä»¶
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak

# é€æ®µæ³¨é‡Šé…ç½®å†…å®¹ï¼Œæ‰¾å‡ºé—®é¢˜æ®µè½
# ç„¶åä½¿ç”¨ nginx -t æµ‹è¯•
```

**æŠ€å·§2ï¼šä½¿ç”¨è¯­æ³•é«˜äº®ç¼–è¾‘å™¨**
```bash
# ä½¿ç”¨vimç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆæœ‰è¯­æ³•é«˜äº®ï¼‰
sudo vim /etc/nginx/nginx.conf

# ä½¿ç”¨nanoç¼–è¾‘ï¼ˆç®€å•æ˜“ç”¨ï¼‰
sudo nano /etc/nginx/nginx.conf
```

### 4.4 å¸¸è§é…ç½®è¯­æ³•é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ


**âŒ é”™è¯¯ç±»å‹1ï¼šç¼ºå°‘åˆ†å·æˆ–æ‹¬å·**
```nginx
# é”™è¯¯ç¤ºä¾‹
server {
    listen 80
    server_name example.com  # ç¼ºå°‘åˆ†å·
    root /var/www/html
}

# æ­£ç¡®å†™æ³•
server {
    listen 80;
    server_name example.com;
    root /var/www/html;
}
```

**âŒ é”™è¯¯ç±»å‹2ï¼šæŒ‡ä»¤æ‹¼å†™é”™è¯¯**
```apache
# é”™è¯¯ç¤ºä¾‹
<VirtualHost *:80>
    DocumentRoot /var/www/html
    ServerNam example.com    # ServerNameæ‹¼å†™é”™è¯¯
</VirtualHost>

# æ­£ç¡®å†™æ³•
<VirtualHost *:80>
    DocumentRoot /var/www/html
    ServerName example.com
</VirtualHost>
```

**âŒ é”™è¯¯ç±»å‹3ï¼šå‚æ•°æ ¼å¼é”™è¯¯**
```bash
# é”™è¯¯ç¤ºä¾‹ï¼šsystemdæœåŠ¡æ–‡ä»¶
[Service]
Type=forking
ExecStart=/usr/bin/myapp
Restart=on-failure
RestartSec=5s    # é”™è¯¯ï¼šä¸åº”è¯¥æœ‰å•ä½

# æ­£ç¡®å†™æ³•
[Service]
Type=forking
ExecStart=/usr/bin/myapp
Restart=on-failure
RestartSec=5
```

**ğŸ’¡ é¢„é˜²é…ç½®é”™è¯¯çš„å»ºè®®**ï¼š
- **ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶**ï¼šé…ç½®æ–‡ä»¶ä¿®æ”¹å‰å…ˆå¤‡ä»½
- **æ¸è¿›å¼ä¿®æ”¹**ï¼šä¸€æ¬¡åªä¿®æ”¹ä¸€å°éƒ¨åˆ†é…ç½®
- **ç«‹å³æµ‹è¯•**ï¼šæ¯æ¬¡ä¿®æ”¹åç«‹å³è¿›è¡Œè¯­æ³•æ£€æŸ¥
- **å‚è€ƒæ–‡æ¡£**ï¼šä¸ç¡®å®šçš„å‚æ•°æŸ¥é˜…å®˜æ–¹æ–‡æ¡£
- **ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·**ï¼šå¦‚Ansibleç¡®ä¿é…ç½®ä¸€è‡´æ€§

---

## 5. ğŸšª ç«¯å£å ç”¨å¯¼è‡´å¯åŠ¨å¤±è´¥


### 5.1 ç«¯å£å ç”¨é—®é¢˜çš„è¡¨ç°


**ä»€ä¹ˆæ˜¯ç«¯å£å ç”¨ï¼Ÿ**
æƒ³è±¡ä½ è¦æŠŠè½¦åœåˆ°åœè½¦ä½ï¼Œä½†å‘ç°åœè½¦ä½å·²ç»è¢«åˆ«çš„è½¦å äº†ã€‚åŒæ ·ï¼Œå½“ä¸€ä¸ªæœåŠ¡æƒ³è¦ä½¿ç”¨æŸä¸ªç«¯å£æ—¶ï¼Œå¦‚æœå‘ç°ç«¯å£å·²ç»è¢«å…¶ä»–ç¨‹åºå ç”¨ï¼Œå°±æ— æ³•å¯åŠ¨ã€‚

**ğŸ” ç«¯å£å ç”¨çš„å…¸å‹é”™è¯¯ä¿¡æ¯**ï¼š
```
å¸¸è§é”™è¯¯æç¤ºï¼š
âŒ Address already in use
âŒ bind: Address already in use
âŒ Cannot bind to port 80
âŒ Port 3306 is already in use
âŒ listen tcp :80: bind: address already in use
```

### 5.2 è¯Šæ–­ç«¯å£å ç”¨é—®é¢˜


**ğŸ•µï¸ æ£€æŸ¥ç«¯å£å ç”¨çŠ¶æ€**ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰ç›‘å¬çš„ç«¯å£
sudo netstat -tulpn

# æŸ¥çœ‹ç‰¹å®šç«¯å£çš„å ç”¨æƒ…å†µ
sudo netstat -tulpn | grep :80

# ä½¿ç”¨sså‘½ä»¤ï¼ˆæ›´ç°ä»£çš„å·¥å…·ï¼‰
sudo ss -tulpn | grep :80

# æŸ¥çœ‹è°åœ¨ä½¿ç”¨ç‰¹å®šç«¯å£
sudo lsof -i :80

# æŸ¥çœ‹è¿›ç¨‹çš„ç«¯å£ä½¿ç”¨æƒ…å†µ
sudo lsof -i -P | grep LISTEN
```

**ğŸ“Š ç«¯å£çŠ¶æ€è§£è¯»**ï¼š
```
netstatè¾“å‡ºè§£è¯»ï¼š
tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN 1234/nginx

å«ä¹‰ï¼š
- tcp: åè®®ç±»å‹
- 0.0.0.0:80: ç›‘å¬æ‰€æœ‰IPçš„80ç«¯å£
- LISTEN: ç«¯å£çŠ¶æ€ä¸ºç›‘å¬
- 1234/nginx: è¿›ç¨‹IDä¸º1234ï¼Œç¨‹åºæ˜¯nginx
```

### 5.3 è§£å†³ç«¯å£å ç”¨é—®é¢˜


**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆé€‰æ‹©æµç¨‹**ï¼š

```
å¤„ç†å†³ç­–æ ‘ï¼š
å‘ç°ç«¯å£è¢«å ç”¨
       â†“
æ˜¯å¦æ˜¯é”™è¯¯çš„æœåŠ¡å ç”¨ï¼Ÿ
   â†“æ˜¯              â†“å¦
åœæ­¢é”™è¯¯æœåŠ¡    æ˜¯å¦å¯ä»¥ä¿®æ”¹ç«¯å£ï¼Ÿ
   â†“              â†“æ˜¯        â†“å¦
å¯åŠ¨ç›®æ ‡æœåŠ¡   ä¿®æ”¹é…ç½®æ–‡ä»¶  åè°ƒç«¯å£ä½¿ç”¨
```

**æ–¹æ¡ˆ1ï¼šåœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡**
```bash
# æ‰¾å‡ºå ç”¨ç«¯å£çš„è¿›ç¨‹
sudo lsof -i :80

# åœæ­¢ç‰¹å®šæœåŠ¡
sudo systemctl stop apache2

# æˆ–è€…æ€æ­»ç‰¹å®šè¿›ç¨‹ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
sudo kill -9 1234

# å¯åŠ¨ç›®æ ‡æœåŠ¡
sudo systemctl start nginx
```

**æ–¹æ¡ˆ2ï¼šä¿®æ”¹æœåŠ¡ç«¯å£**
```bash
# ä¿®æ”¹nginxé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/default

# å°†listen 80ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£
listen 8080;

# é‡å¯æœåŠ¡
sudo systemctl restart nginx
```

**æ–¹æ¡ˆ3ï¼šé…ç½®ç«¯å£å…±äº«**
æŸäº›æƒ…å†µä¸‹ï¼Œå¤šä¸ªæœåŠ¡å¯ä»¥å…±äº«ç«¯å£ï¼š
```bash
# Apacheå’ŒNginxå¯ä»¥é…ç½®ä¸ºä»£ç†æ¨¡å¼
# Nginxä½œä¸ºåå‘ä»£ç†ï¼ŒApacheä½œä¸ºåç«¯æœåŠ¡å™¨

# Nginxé…ç½®ç¤ºä¾‹
location / {
    proxy_pass http://127.0.0.1:8080;
}
```

### 5.4 é¢„é˜²ç«¯å£å†²çª


**ğŸ’¡ ç«¯å£ç®¡ç†æœ€ä½³å®è·µ**ï¼š

**å»ºç«‹ç«¯å£ä½¿ç”¨è§„èŒƒ**ï¼š
```
ç«¯å£åˆ†é…å»ºè®®ï¼š
ç³»ç»ŸæœåŠ¡ï¼š    1-1023 (éœ€è¦rootæƒé™)
ç”¨æˆ·æœåŠ¡ï¼š    1024-65535
å¼€å‘æµ‹è¯•ï¼š    8000-8999
æ•°æ®åº“ï¼š      3306(MySQL), 5432(PostgreSQL)
WebæœåŠ¡ï¼š     80(HTTP), 443(HTTPS), 8080(å¤‡ç”¨)
```

**ä½¿ç”¨é…ç½®ç®¡ç†**ï¼š
```bash
# åˆ›å»ºç«¯å£é…ç½®æ–‡ä»¶
echo "NGINX_PORT=80" | sudo tee /etc/default/nginx
echo "APACHE_PORT=8080" | sudo tee /etc/default/apache2

# åœ¨æœåŠ¡é…ç½®ä¸­å¼•ç”¨ç¯å¢ƒå˜é‡
# nginxé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡æ›¿æ¢
```

**ç›‘æ§ç«¯å£ä½¿ç”¨**ï¼š
```bash
# åˆ›å»ºç«¯å£ç›‘æ§è„šæœ¬
#!/bin/bash
# check_ports.sh
PORTS="80 443 22 3306"
for port in $PORTS; do
    if sudo lsof -i :$port > /dev/null; then
        echo "Port $port is in use by:"
        sudo lsof -i :$port
    else
        echo "Port $port is available"
    fi
done
```

---

## 6. ğŸ‘¤ ç”¨æˆ·æƒé™ä¸è¶³é—®é¢˜


### 6.1 æƒé™ä¸è¶³é—®é¢˜çš„è¡¨ç°


**ä»€ä¹ˆæ˜¯æƒé™ä¸è¶³ï¼Ÿ**
å°±åƒä½ æƒ³è¿›å…¥æŸä¸ªæˆ¿é—´ï¼Œä½†æ²¡æœ‰é’¥åŒ™ä¸€æ ·ã€‚Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶ã€ç›®å½•å’Œæ“ä½œéƒ½æœ‰æƒé™æ§åˆ¶ï¼Œå½“æœåŠ¡å°è¯•è®¿é—®å®ƒæ²¡æœ‰æƒé™çš„èµ„æºæ—¶ï¼Œå°±ä¼šå¯åŠ¨å¤±è´¥ã€‚

**ğŸš¨ æƒé™ä¸è¶³çš„å…¸å‹é”™è¯¯**ï¼š
```
å¸¸è§æƒé™é”™è¯¯ä¿¡æ¯ï¼š
âŒ Permission denied
âŒ Operation not permitted
âŒ Access denied
âŒ Cannot create directory: Permission denied
âŒ Failed to open log file: Permission denied
âŒ User 'www-data' cannot access '/root/app'
```

### 6.2 ç†è§£Linuxæƒé™æ¨¡å‹


**ğŸ  æƒé™åŸºç¡€æ¦‚å¿µ**ï¼š

```
æƒé™ä½“ç³»å›¾è§£ï¼š
æ–‡ä»¶æƒé™ï¼šrwx rwx rwx
          â†‘   â†‘   â†‘
        æ‰€æœ‰è€… ç»„ å…¶ä»–äºº

r = read (è¯»)    = 4
w = write (å†™)   = 2  
x = execute (æ‰§è¡Œ) = 1

ç¤ºä¾‹ï¼š
-rw-r--r-- 1 root root    0 date file.txt
 â†‘    â†‘  â†‘    â†‘    â†‘
æ–‡ä»¶  ç»„  å…¶ä»–  æ‰€æœ‰è€… ç»„å
æƒé™  æƒé™ æƒé™
```

**ğŸ” æƒé™è¯Šæ–­å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹æ–‡ä»¶æƒé™å’Œæ‰€æœ‰è€…
ls -la /var/log/nginx/

# æŸ¥çœ‹ç›®å½•æƒé™
ls -ld /var/www/html/

# æŸ¥çœ‹å½“å‰ç”¨æˆ·å’Œç»„ä¿¡æ¯
id
whoami
groups

# æŸ¥çœ‹è¿›ç¨‹çš„ç”¨æˆ·èº«ä»½
ps aux | grep nginx
```

### 6.3 è¯Šæ–­æœåŠ¡æƒé™é—®é¢˜


**ğŸ•µï¸ æƒé™é—®é¢˜æ’æŸ¥æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šç¡®å®šæœåŠ¡è¿è¡Œç”¨æˆ·**
```bash
# æŸ¥çœ‹æœåŠ¡é…ç½®ä¸­çš„ç”¨æˆ·è®¾ç½®
systemctl cat nginx | grep User

# æŸ¥çœ‹è¿›ç¨‹å®é™…è¿è¡Œç”¨æˆ·
ps aux | grep nginx

# æ£€æŸ¥æœåŠ¡é…ç½®æ–‡ä»¶ä¸­çš„ç”¨æˆ·é…ç½®
sudo nano /etc/nginx/nginx.conf
# æŸ¥æ‰¾ï¼šuser www-data;
```

**æ­¥éª¤2ï¼šæ£€æŸ¥å…³é”®ç›®å½•æƒé™**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶ç›®å½•æƒé™
ls -la /etc/nginx/

# æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
ls -la /var/log/nginx/

# æ£€æŸ¥ç½‘ç«™æ ¹ç›®å½•æƒé™
ls -la /var/www/

# æ£€æŸ¥PIDæ–‡ä»¶ç›®å½•æƒé™
ls -la /run/ | grep nginx
```

**æ­¥éª¤3ï¼šéªŒè¯æƒé™åŒ¹é…**
```bash
# æµ‹è¯•ç”¨æˆ·èƒ½å¦è®¿é—®å…³é”®æ–‡ä»¶
sudo -u www-data cat /etc/nginx/nginx.conf
sudo -u www-data touch /var/log/nginx/test.log
sudo -u www-data ls /var/www/html/
```

### 6.4 è§£å†³æƒé™é—®é¢˜


**ğŸ› ï¸ æƒé™ä¿®å¤æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ1ï¼šä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…**
```bash
# ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…ä¸ºæœåŠ¡ç”¨æˆ·
sudo chown www-data:www-data /var/www/html/

# é€’å½’ä¿®æ”¹ç›®å½•æ‰€æœ‰è€…
sudo chown -R www-data:www-data /var/www/html/

# ä¿®æ”¹æ—¥å¿—ç›®å½•æƒé™
sudo chown www-data:www-data /var/log/nginx/
```

**æ–¹æ¡ˆ2ï¼šè°ƒæ•´æ–‡ä»¶æƒé™**
```bash
# ç»™æ‰€æœ‰è€…æ·»åŠ å†™æƒé™
sudo chmod u+w /var/log/nginx/error.log

# ç»™ç»„æ·»åŠ è¯»å†™æƒé™
sudo chmod g+rw /var/www/html/index.html

# è®¾ç½®ç›®å½•æƒé™ï¼ˆ755é€šå¸¸é€‚åˆç›®å½•ï¼‰
sudo chmod 755 /var/www/html/

# è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆ644é€šå¸¸é€‚åˆç½‘é¡µæ–‡ä»¶ï¼‰
sudo chmod 644 /var/www/html/index.html
```

**æ–¹æ¡ˆ3ï¼šæ·»åŠ ç”¨æˆ·åˆ°ç»„**
```bash
# å°†ç”¨æˆ·æ·»åŠ åˆ°ç‰¹å®šç»„
sudo usermod -a -G www-data myuser

# åˆ›å»ºå…±äº«ç»„
sudo groupadd webdev
sudo usermod -a -G webdev www-data
sudo usermod -a -G webdev developer

# è®¾ç½®ç»„æƒé™
sudo chgrp webdev /var/www/html/
sudo chmod g+w /var/www/html/
```

### 6.5 æƒé™å®‰å…¨æœ€ä½³å®è·µ


**ğŸ” å®‰å…¨æƒé™é…ç½®åŸåˆ™**ï¼š

**æœ€å°æƒé™åŸåˆ™**ï¼š
- æœåŠ¡åªè·å¾—å¿…éœ€çš„æœ€å°æƒé™
- é¿å…ä½¿ç”¨rootç”¨æˆ·è¿è¡Œåº”ç”¨æœåŠ¡
- å®šæœŸå®¡æŸ¥å’Œæ¸…ç†ä¸å¿…è¦çš„æƒé™

**ğŸ¯ å¸¸è§æœåŠ¡çš„æƒé™é…ç½®**ï¼š
```
WebæœåŠ¡å™¨(Nginx/Apache)ï¼š
ç”¨æˆ·ï¼šwww-data æˆ– apache
é…ç½®æ–‡ä»¶æƒé™ï¼š644 (rw-r--r--)
æ—¥å¿—ç›®å½•æƒé™ï¼š755ï¼Œæ–‡ä»¶644
ç½‘ç«™å†…å®¹æƒé™ï¼š755(ç›®å½•)ï¼Œ644(æ–‡ä»¶)

æ•°æ®åº“æœåŠ¡(MySQL)ï¼š
ç”¨æˆ·ï¼šmysql
æ•°æ®ç›®å½•æƒé™ï¼š700 (drwx------)
é…ç½®æ–‡ä»¶æƒé™ï¼š644
æ—¥å¿—æ–‡ä»¶æƒé™ï¼š640 (rw-r-----)
```

**âš ï¸ æƒé™é…ç½®å¸¸è§é™·é˜±**ï¼š
```
é™·é˜±1ï¼šç»™äºˆè¿‡é«˜æƒé™
é”™è¯¯ï¼šchmod 777 /var/www/  # ä»»ä½•äººéƒ½èƒ½ä¿®æ”¹
æ­£ç¡®ï¼šchmod 755 /var/www/  # åˆç†çš„æƒé™è®¾ç½®

é™·é˜±2ï¼šå¿½ç•¥SELinux/AppArmor
é”™è¯¯ï¼šåªä¿®æ”¹ä¼ ç»Ÿæƒé™ï¼Œå¿½ç•¥å®‰å…¨æ¨¡å—
æ­£ç¡®ï¼šåŒæ—¶æ£€æŸ¥SELinux context

é™·é˜±3ï¼šæƒé™ä¿®æ”¹è¿‡äºå®½æ³›
é”™è¯¯ï¼šchmod -R 777 /       # å±é™©ï¼
æ­£ç¡®ï¼šåªä¿®æ”¹å¿…è¦çš„æ–‡ä»¶å’Œç›®å½•
```

---

## 7. ğŸŒ ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯


### 7.1 ç¯å¢ƒå˜é‡å¯¹æœåŠ¡å¯åŠ¨çš„å½±å“


**ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡ï¼Ÿ**
ç¯å¢ƒå˜é‡å°±åƒæ˜¯ç»™ç¨‹åºçš„"å°çº¸æ¡"ï¼Œä¸Šé¢å†™ç€ç¨‹åºè¿è¡Œæ—¶éœ€è¦çš„é‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚"æ•°æ®åº“åœ¨å“ªé‡Œ"ã€"é…ç½®æ–‡ä»¶æ”¾åœ¨å“ªå„¿"ã€"ç”¨ä»€ä¹ˆè¯­è¨€æ˜¾ç¤ºç•Œé¢"ç­‰ã€‚å¦‚æœè¿™äº›å°çº¸æ¡å†™é”™äº†æˆ–ä¸¢äº†ï¼Œç¨‹åºå°±ä¸çŸ¥é“è¯¥æ€ä¹ˆå·¥ä½œã€‚

**ğŸ”§ ç¯å¢ƒå˜é‡çš„ä½œç”¨èŒƒå›´**ï¼š
```
ç¯å¢ƒå˜é‡ä½œç”¨å±‚æ¬¡ï¼š
ç³»ç»Ÿçº§ â†’ å½±å“æ‰€æœ‰ç”¨æˆ·å’ŒæœåŠ¡
ç”¨æˆ·çº§ â†’ å½±å“ç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰ç¨‹åº  
ä¼šè¯çº§ â†’ å½±å“å½“å‰ç»ˆç«¯ä¼šè¯
è¿›ç¨‹çº§ â†’ å½±å“ç‰¹å®šè¿›ç¨‹å’Œå­è¿›ç¨‹
```

### 7.2 è¯Šæ–­ç¯å¢ƒå˜é‡é—®é¢˜


**ğŸ” æ£€æŸ¥ç¯å¢ƒå˜é‡çš„æ–¹æ³•**ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡
printenv
# æˆ–è€…
env

# æŸ¥çœ‹ç‰¹å®šç¯å¢ƒå˜é‡
echo $PATH
echo $HOME
echo $USER

# æŸ¥çœ‹æœåŠ¡å¯åŠ¨æ—¶çš„ç¯å¢ƒå˜é‡
systemctl show-environment

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„ç¯å¢ƒå˜é‡
systemctl cat myservice.service | grep Environment
```

**ğŸ•µï¸ å¸¸è§ç¯å¢ƒå˜é‡é—®é¢˜è¯Šæ–­**ï¼š

**é—®é¢˜1ï¼šPATHå˜é‡ä¸æ­£ç¡®**
```bash
# æ£€æŸ¥PATHå˜é‡
echo $PATH

# æŸ¥æ‰¾å‘½ä»¤çš„å®é™…ä½ç½®
which python3
whereis nginx

# æ‰‹åŠ¨æµ‹è¯•å‘½ä»¤èƒ½å¦æ‰¾åˆ°
/usr/bin/python3 --version
```

**é—®é¢˜2ï¼šåº”ç”¨ç‰¹å®šç¯å¢ƒå˜é‡ç¼ºå¤±**
```bash
# Javaåº”ç”¨æ£€æŸ¥JAVA_HOME
echo $JAVA_HOME
ls -la $JAVA_HOME/bin/java

# Pythonåº”ç”¨æ£€æŸ¥PYTHONPATH
echo $PYTHONPATH

# Node.jsåº”ç”¨æ£€æŸ¥NODE_ENV
echo $NODE_ENV
```

### 7.3 è§£å†³ç¯å¢ƒå˜é‡é—®é¢˜


**ğŸ› ï¸ ç³»ç»Ÿçº§ç¯å¢ƒå˜é‡é…ç½®**ï¼š

```bash
# åœ¨/etc/environmentä¸­è®¾ç½®å…¨å±€ç¯å¢ƒå˜é‡
sudo nano /etc/environment

# æ·»åŠ å†…å®¹ç¤ºä¾‹
JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
PYTHON_HOME=/usr/bin/python3
NODE_ENV=production

# é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡
source /etc/environment
```

**ğŸ¯ æœåŠ¡ç‰¹å®šç¯å¢ƒå˜é‡é…ç½®**ï¼š

**æ–¹æ³•1ï¼šåœ¨systemdæœåŠ¡æ–‡ä»¶ä¸­è®¾ç½®**
```bash
# ç¼–è¾‘æœåŠ¡æ–‡ä»¶
sudo systemctl edit myapp.service

# æ·»åŠ ç¯å¢ƒå˜é‡
[Service]
Environment="NODE_ENV=production"
Environment="DATABASE_URL=mongodb://localhost:27017/myapp"
Environment="API_KEY=your_api_key_here"
EnvironmentFile=/etc/myapp/environment

# é‡æ–°åŠ è½½å¹¶å¯åŠ¨
sudo systemctl daemon-reload
sudo systemctl start myapp.service
```

**æ–¹æ³•2ï¼šä½¿ç”¨ç¯å¢ƒæ–‡ä»¶**
```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
sudo nano /etc/myapp/environment

# æ–‡ä»¶å†…å®¹
NODE_ENV=production
DATABASE_URL=mongodb://localhost:27017/myapp
LOG_LEVEL=info
PORT=3000

# ç¡®ä¿æƒé™æ­£ç¡®
sudo chmod 644 /etc/myapp/environment
sudo chown root:root /etc/myapp/environment
```

**æ–¹æ³•3ï¼šåœ¨å¯åŠ¨è„šæœ¬ä¸­è®¾ç½®**
```bash
# åˆ›å»ºå¯åŠ¨è„šæœ¬
sudo nano /usr/local/bin/myapp-start.sh

#!/bin/bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export NODE_ENV=production
export DATABASE_URL=mongodb://localhost:27017/myapp

# å¯åŠ¨åº”ç”¨
cd /opt/myapp
exec node app.js

# ä½¿è„šæœ¬å¯æ‰§è¡Œ
sudo chmod +x /usr/local/bin/myapp-start.sh
```

### 7.4 ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ


**ğŸ’¡ é…ç½®ç®¡ç†å»ºè®®**ï¼š

**åˆ†å±‚ç®¡ç†åŸåˆ™**ï¼š
```
é…ç½®å±‚æ¬¡å»ºè®®ï¼š
1. ç³»ç»Ÿé»˜è®¤å€¼ï¼š/etc/environment
2. æœåŠ¡é…ç½®ï¼š/etc/systemd/system/service.conf.d/
3. åº”ç”¨é…ç½®ï¼šåº”ç”¨ä¸“ç”¨çš„ç¯å¢ƒæ–‡ä»¶
4. è¿è¡Œæ—¶è¦†ç›–ï¼šå‘½ä»¤è¡Œå‚æ•°æˆ–ä¸´æ—¶å˜é‡
```

**ğŸ” å®‰å…¨è€ƒè™‘**ï¼š
```bash
# æ•æ„Ÿä¿¡æ¯ä½¿ç”¨å—ä¿æŠ¤çš„æ–‡ä»¶
sudo nano /etc/myapp/secrets.env
# è®¾ç½®ä¸¥æ ¼æƒé™
sudo chmod 600 /etc/myapp/secrets.env
sudo chown myapp:myapp /etc/myapp/secrets.env

# åœ¨æœåŠ¡æ–‡ä»¶ä¸­å¼•ç”¨
[Service]
EnvironmentFile=-/etc/myapp/secrets.env
```

**ğŸ§ª ç¯å¢ƒå˜é‡æµ‹è¯•**ï¼š
```bash
# åˆ›å»ºæµ‹è¯•è„šæœ¬éªŒè¯ç¯å¢ƒå˜é‡
#!/bin/bash
# test-env.sh
echo "Testing environment variables..."
echo "NODE_ENV: $NODE_ENV"
echo "DATABASE_URL: $DATABASE_URL"
echo "PATH: $PATH"

# ä½¿ç”¨æœåŠ¡ç”¨æˆ·èº«ä»½æµ‹è¯•
sudo -u myapp bash test-env.sh
```

---

## 8. ğŸ“ æœåŠ¡æ–‡ä»¶è·¯å¾„é—®é¢˜


### 8.1 è·¯å¾„é—®é¢˜çš„è¡¨ç°å½¢å¼


**ä»€ä¹ˆæ˜¯æœåŠ¡æ–‡ä»¶è·¯å¾„é—®é¢˜ï¼Ÿ**
å°±åƒä½ å‘Šè¯‰æœ‹å‹å»æŸä¸ªåœ°å€æ‰¾ä½ ï¼Œä½†åœ°å€å†™é”™äº†ï¼Œæœ‹å‹å°±æ‰¾ä¸åˆ°ä½ ä¸€æ ·ã€‚æœåŠ¡å¯åŠ¨æ—¶éœ€è¦æ‰¾åˆ°æ‰§è¡Œæ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ç­‰ï¼Œå¦‚æœè·¯å¾„å†™é”™äº†ï¼ŒæœåŠ¡å°±å¯åŠ¨ä¸äº†ã€‚

**ğŸš¨ è·¯å¾„é”™è¯¯çš„å…¸å‹ç—‡çŠ¶**ï¼š
```
å¸¸è§è·¯å¾„é”™è¯¯ä¿¡æ¯ï¼š
âŒ No such file or directory
âŒ Cannot find executable: /usr/bin/myapp
âŒ Config file not found: /etc/myapp/config.conf
âŒ Failed to open log file: /var/log/myapp/app.log
âŒ WorkingDirectory path does not exist
```

### 8.2 æœåŠ¡æ–‡ä»¶è·¯å¾„ç»“æ„


**ğŸ“‚ systemdæœåŠ¡æ–‡ä»¶çš„å…³é”®è·¯å¾„é…ç½®**ï¼š

```ini
[Unit]
Description=My Application
After=network.target

[Service]
Type=forking
User=myapp
Group=myapp
# æ‰§è¡Œæ–‡ä»¶è·¯å¾„
ExecStart=/usr/bin/myapp --config /etc/myapp/config.conf
# å·¥ä½œç›®å½•
WorkingDirectory=/opt/myapp
# PIDæ–‡ä»¶è·¯å¾„  
PIDFile=/run/myapp/myapp.pid
# ç¯å¢ƒæ–‡ä»¶è·¯å¾„
EnvironmentFile=/etc/myapp/environment

[Install]
WantedBy=multi-user.target
```

### 8.3 è¯Šæ–­è·¯å¾„é—®é¢˜


**ğŸ” è·¯å¾„é—®é¢˜æ’æŸ¥æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šéªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨**
```bash
# æ£€æŸ¥æ‰§è¡Œæ–‡ä»¶
ls -la /usr/bin/myapp
file /usr/bin/myapp

# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls -la /etc/myapp/config.conf
cat /etc/myapp/config.conf

# æ£€æŸ¥å·¥ä½œç›®å½•
ls -la /opt/myapp/
pwd && cd /opt/myapp
```

**æ­¥éª¤2ï¼šæ£€æŸ¥è·¯å¾„æƒé™**
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -ld /opt/myapp/
ls -ld /var/log/myapp/
ls -ld /run/myapp/

# æµ‹è¯•æœåŠ¡ç”¨æˆ·èƒ½å¦è®¿é—®è·¯å¾„
sudo -u myapp ls /opt/myapp/
sudo -u myapp touch /var/log/myapp/test.log
```

**æ­¥éª¤3ï¼šéªŒè¯è·¯å¾„é…ç½®**
```bash
# æŸ¥çœ‹æœåŠ¡æ–‡ä»¶ä¸­çš„è·¯å¾„é…ç½®
systemctl cat myapp.service

# ä½¿ç”¨ç»å¯¹è·¯å¾„æµ‹è¯•å‘½ä»¤
/usr/bin/myapp --help
```

### 8.4 è§£å†³è·¯å¾„é—®é¢˜


**ğŸ› ï¸ è·¯å¾„ä¿®å¤æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ1ï¼šåˆ›å»ºç¼ºå¤±çš„ç›®å½•å’Œæ–‡ä»¶**
```bash
# åˆ›å»ºå¿…è¦çš„ç›®å½•
sudo mkdir -p /opt/myapp
sudo mkdir -p /var/log/myapp
sudo mkdir -p /run/myapp
sudo mkdir -p /etc/myapp

# è®¾ç½®æ­£ç¡®çš„æ‰€æœ‰è€…å’Œæƒé™
sudo chown -R myapp:myapp /opt/myapp
sudo chown -R myapp:myapp /var/log/myapp
sudo chown -R myapp:myapp /run/myapp

# è®¾ç½®ç›®å½•æƒé™
sudo chmod 755 /opt/myapp
sudo chmod 755 /var/log/myapp
sudo chmod 755 /run/myapp
```

**æ–¹æ¡ˆ2ï¼šä¿®æ­£æœåŠ¡æ–‡ä»¶ä¸­çš„è·¯å¾„**
```bash
# ç¼–è¾‘æœåŠ¡æ–‡ä»¶
sudo systemctl edit myapp.service

# ä¿®æ­£è·¯å¾„é…ç½®
[Service]
# ä½¿ç”¨æ­£ç¡®çš„æ‰§è¡Œæ–‡ä»¶è·¯å¾„
ExecStart=/usr/local/bin/myapp --config /etc/myapp/myapp.conf
# ä½¿ç”¨å­˜åœ¨çš„å·¥ä½œç›®å½•
WorkingDirectory=/home/myapp
# ä½¿ç”¨æ­£ç¡®çš„PIDæ–‡ä»¶è·¯å¾„
PIDFile=/var/run/myapp.pid

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload
```

**æ–¹æ¡ˆ3ï¼šåˆ›å»ºç¬¦å·é“¾æ¥**
```bash
# ä¸ºå¯æ‰§è¡Œæ–‡ä»¶åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /opt/myapp/bin/myapp /usr/bin/myapp

# ä¸ºé…ç½®æ–‡ä»¶åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /opt/myapp/config/myapp.conf /etc/myapp/config.conf

# éªŒè¯ç¬¦å·é“¾æ¥
ls -la /usr/bin/myapp
ls -la /etc/myapp/config.conf
```

### 8.5 è·¯å¾„é…ç½®æœ€ä½³å®è·µ


**ğŸ“‹ æ ‡å‡†ç›®å½•å¸ƒå±€å»ºè®®**ï¼š

```
Linuxç›®å½•ä½¿ç”¨æ ‡å‡†ï¼š
/usr/bin/          â†’ ç³»ç»Ÿå¯æ‰§è¡Œæ–‡ä»¶
/usr/local/bin/    â†’ æœ¬åœ°å®‰è£…çš„å¯æ‰§è¡Œæ–‡ä»¶
/opt/appname/      â†’ ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åº
/etc/appname/      â†’ åº”ç”¨é…ç½®æ–‡ä»¶
/var/log/appname/  â†’ åº”ç”¨æ—¥å¿—æ–‡ä»¶
/var/run/appname/  â†’ è¿è¡Œæ—¶æ–‡ä»¶ï¼ˆPIDç­‰ï¼‰
/var/lib/appname/  â†’ åº”ç”¨æ•°æ®æ–‡ä»¶
```

**ğŸ’¡ è·¯å¾„é…ç½®æŠ€å·§**ï¼š

**ä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„åœºæ™¯**ï¼š
```ini
# å½“åº”ç”¨åœ¨å›ºå®šå·¥ä½œç›®å½•æ—¶
[Service]
WorkingDirectory=/opt/myapp
ExecStart=./bin/myapp --config ./config/app.conf
```

**ä½¿ç”¨ç¯å¢ƒå˜é‡çš„åœºæ™¯**ï¼š
```ini
# ä½¿è·¯å¾„é…ç½®æ›´çµæ´»
[Service]
Environment="APP_HOME=/opt/myapp"
ExecStart=${APP_HOME}/bin/myapp --config ${APP_HOME}/config/app.conf
```

**ğŸ” è·¯å¾„éªŒè¯è„šæœ¬**ï¼š
```bash
#!/bin/bash
# verify-paths.sh
echo "Verifying service paths..."

PATHS=(
    "/usr/bin/myapp"
    "/etc/myapp/config.conf"
    "/var/log/myapp"
    "/opt/myapp"
    "/run/myapp"
)

for path in "${PATHS[@]}"; do
    if [ -e "$path" ]; then
        echo "âœ“ $path exists"
        ls -ld "$path"
    else
        echo "âœ— $path does not exist"
    fi
done
```

---

## 9. â±ï¸ æœåŠ¡è¶…æ—¶é…ç½®è°ƒæ•´


### 9.1 æœåŠ¡è¶…æ—¶é—®é¢˜çš„è¡¨ç°


**ä»€ä¹ˆæ˜¯æœåŠ¡è¶…æ—¶ï¼Ÿ**
å°±åƒä½ ç­‰å…¬äº¤è½¦ï¼Œå¦‚æœè½¦è¿Ÿè¿Ÿä¸æ¥ï¼Œä½ ä¼šæ”¾å¼ƒç­‰å¾…å»æ‰¾å…¶ä»–äº¤é€šæ–¹å¼ã€‚åŒæ ·ï¼Œsystemdåœ¨å¯åŠ¨æœåŠ¡æ—¶ä¼šè®¾ç½®ä¸€ä¸ªç­‰å¾…æ—¶é—´ï¼Œå¦‚æœæœåŠ¡åœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æˆåŠŸå¯åŠ¨ï¼Œsystemdå°±ä¼šè®¤ä¸ºå¯åŠ¨å¤±è´¥ã€‚

**ğŸ• è¶…æ—¶é—®é¢˜çš„å…¸å‹è¡¨ç°**ï¼š
```
è¶…æ—¶é”™è¯¯ä¿¡æ¯ï¼š
âŒ Start operation timed out. Terminating.
âŒ Service start operation timed out and was killed.
âŒ A start job is running for... (1min 30s / 1min 30s)
âŒ Timed out waiting for device...
```

### 9.2 ç†è§£systemdè¶…æ—¶æœºåˆ¶


**â° systemdè¶…æ—¶ç±»å‹**ï¼š

```
è¶…æ—¶é…ç½®å‚æ•°è¯´æ˜ï¼š
TimeoutStartSec=     â†’ æœåŠ¡å¯åŠ¨è¶…æ—¶æ—¶é—´
TimeoutStopSec=      â†’ æœåŠ¡åœæ­¢è¶…æ—¶æ—¶é—´  
TimeoutSec=          â†’ åŒæ—¶è®¾ç½®å¯åŠ¨å’Œåœæ­¢è¶…æ—¶
RuntimeMaxSec=       â†’ æœåŠ¡è¿è¡Œæœ€é•¿æ—¶é—´
WatchdogSec=         â†’ çœ‹é—¨ç‹—è¶…æ—¶æ—¶é—´

é»˜è®¤è¶…æ—¶æ—¶é—´ï¼š
å¯åŠ¨è¶…æ—¶ï¼š90ç§’
åœæ­¢è¶…æ—¶ï¼š90ç§’
```

**ğŸ” æ£€æŸ¥å½“å‰è¶…æ—¶é…ç½®**ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡çš„è¶…æ—¶é…ç½®
systemctl show myapp.service | grep Timeout

# æŸ¥çœ‹æœåŠ¡çš„è¯¦ç»†é…ç½®
systemctl cat myapp.service

# ç›‘æ§æœåŠ¡å¯åŠ¨è¿‡ç¨‹
systemctl status myapp.service -l
```

### 9.3 è¯Šæ–­è¶…æ—¶é—®é¢˜


**ğŸ•µï¸ è¶…æ—¶é—®é¢˜åˆ†ææ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šç¡®å®šè¶…æ—¶ç±»å‹**
```bash
# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å“ªç§è¶…æ—¶
journalctl -u myapp.service --since "5 minutes ago"

# æ£€æŸ¥æ˜¯å¯åŠ¨è¶…æ—¶è¿˜æ˜¯åœæ­¢è¶…æ—¶
systemctl status myapp.service
```

**æ­¥éª¤2ï¼šåˆ†ææœåŠ¡å¯åŠ¨æ—¶é—´**
```bash
# æµ‹é‡æœåŠ¡å®é™…å¯åŠ¨æ—¶é—´
time systemctl start myapp.service

# ä½¿ç”¨systemd-analyzeåˆ†æå¯åŠ¨æ—¶é—´
systemd-analyze blame
systemd-analyze critical-chain myapp.service
```

**æ­¥éª¤3ï¼šè¯†åˆ«æ…¢å¯åŠ¨åŸå› **
```bash
# æ£€æŸ¥æœåŠ¡å¯åŠ¨æ—¶çš„èµ„æºä½¿ç”¨
sudo strace -f -o /tmp/myapp-start.trace systemctl start myapp.service

# æ£€æŸ¥ç£ç›˜IOæƒ…å†µ
sudo iotop -a -d 1

# æ£€æŸ¥ç½‘ç»œè¿æ¥å»¶è¿Ÿ
ping -c 4 database-server.com
telnet database-server.com 3306
```

### 9.4 è§£å†³è¶…æ—¶é—®é¢˜


**ğŸ› ï¸ è¶…æ—¶é—®é¢˜è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ1ï¼šè°ƒæ•´è¶…æ—¶é…ç½®**
```bash
# ç¼–è¾‘æœåŠ¡æ–‡ä»¶
sudo systemctl edit myapp.service

# å¢åŠ è¶…æ—¶æ—¶é—´
[Service]
TimeoutStartSec=300
TimeoutStopSec=120
# æˆ–è€…è®¾ç½®ä¸ºæ— é™ç­‰å¾…
TimeoutStartSec=infinity

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload
sudo systemctl start myapp.service
```

**æ–¹æ¡ˆ2ï¼šä¼˜åŒ–æœåŠ¡å¯åŠ¨è¿‡ç¨‹**
```ini
# ä½¿ç”¨ä¸åŒçš„æœåŠ¡ç±»å‹
[Service]
# å¯¹äºéœ€è¦é•¿æ—¶é—´åˆå§‹åŒ–çš„æœåŠ¡
Type=forking
# æˆ–è€…ä½¿ç”¨notifyç±»å‹ï¼Œè®©æœåŠ¡ä¸»åŠ¨é€šçŸ¥å¯åŠ¨å®Œæˆ
Type=notify

# é…ç½®PIDæ–‡ä»¶
PIDFile=/run/myapp/myapp.pid

# é…ç½®å¯åŠ¨å‰çš„å‡†å¤‡å·¥ä½œ
ExecStartPre=/bin/mkdir -p /run/myapp
ExecStartPre=/bin/chown myapp:myapp /run/myapp
```

**æ–¹æ¡ˆ3ï¼šåˆ†æ®µå¯åŠ¨ç­–ç•¥**
```ini
# å°†å¤æ‚çš„å¯åŠ¨è¿‡ç¨‹åˆ†è§£
[Service]
Type=forking
ExecStartPre=/opt/myapp/bin/prepare.sh
ExecStartPre=/opt/myapp/bin/check-dependencies.sh
ExecStart=/opt/myapp/bin/myapp
ExecStartPost=/opt/myapp/bin/post-start.sh

# è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
TimeoutStartSec=180
```

### 9.5 è¶…æ—¶é…ç½®ä¼˜åŒ–ç­–ç•¥


**âš¡ å¯åŠ¨æ€§èƒ½ä¼˜åŒ–**ï¼š

**æ•°æ®åº“æœåŠ¡ä¼˜åŒ–ç¤ºä¾‹**ï¼š
```ini
[Unit]
Description=MySQL Database Server
After=network.target

[Service]
Type=notify
User=mysql
# æ•°æ®åº“å¯åŠ¨é€šå¸¸éœ€è¦æ›´é•¿æ—¶é—´
TimeoutStartSec=600
# è®¾ç½®çœ‹é—¨ç‹—è¶…æ—¶
WatchdogSec=60
# ç¯å¢ƒå˜é‡ä¼˜åŒ–
Environment=MYSQLD_PARENT_PID=1

ExecStart=/usr/sbin/mysqld --defaults-file=/etc/mysql/my.cnf
ExecReload=/bin/kill -HUP $MAINPID
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
```

**Webåº”ç”¨æœåŠ¡ä¼˜åŒ–ç¤ºä¾‹**ï¼š
```ini
[Unit]
Description=My Web Application
After=network.target mysql.service

[Service]
Type=simple
User=webapp
# Webåº”ç”¨é€šå¸¸å¯åŠ¨è¾ƒå¿«
TimeoutStartSec=60
TimeoutStopSec=30

# ä¼˜åŒ–å¯åŠ¨è¿‡ç¨‹
ExecStartPre=/usr/bin/test -f /etc/webapp/config.json
ExecStart=/usr/bin/webapp --config /etc/webapp/config.json
ExecReload=/bin/kill -USR1 $MAINPID

# æ•…éšœè‡ªåŠ¨é‡å¯
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**ğŸ’¡ è¶…æ—¶é…ç½®æœ€ä½³å®è·µ**ï¼š

**è®¾ç½®åˆç†è¶…æ—¶æ—¶é—´çš„åŸåˆ™**ï¼š
```
æœåŠ¡ç±»å‹ä¸è¶…æ—¶å»ºè®®ï¼š
è½»é‡çº§WebæœåŠ¡ï¼š30-60ç§’
æ•°æ®åº“æœåŠ¡ï¼š300-600ç§’
å¤§å‹åº”ç”¨æœåŠ¡ï¼š120-300ç§’
æ‰¹å¤„ç†æœåŠ¡ï¼šå¯è®¾ä¸ºinfinity

è€ƒè™‘å› ç´ ï¼š
- æœåŠ¡å¤æ‚åº¦
- ç¡¬ä»¶æ€§èƒ½
- ç½‘ç»œæ¡ä»¶
- æ•°æ®é‡å¤§å°
```

**ç›‘æ§å’Œè°ƒä¼˜**ï¼š
```bash
# åˆ›å»ºå¯åŠ¨æ—¶é—´ç›‘æ§è„šæœ¬
#!/bin/bash
# monitor-startup.sh
SERVICE_NAME="myapp.service"

echo "Monitoring $SERVICE_NAME startup time..."
start_time=$(date +%s)
systemctl start $SERVICE_NAME
end_time=$(date +%s)
duration=$((end_time - start_time))

echo "Service startup took: $duration seconds"
systemctl status $SERVICE_NAME --no-pager
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„è¯Šæ–­æµç¨‹


```
ğŸ”¸ æ•…éšœè¯Šæ–­åŸºæœ¬æ­¥éª¤ï¼š
   ç°è±¡ç¡®è®¤ â†’ æ—¥å¿—åˆ†æ â†’ åŸå› æ’æŸ¥ â†’ è§£å†³æ–¹æ¡ˆ â†’ éªŒè¯æ•ˆæœ

ğŸ”¸ systemdæœåŠ¡åˆ†æï¼š
   systemctl status â†’ journalctl -u â†’ é…ç½®æ£€æŸ¥ â†’ ä¾èµ–éªŒè¯

ğŸ”¸ å¸¸è§é—®é¢˜åˆ†ç±»ï¼š
   ä¾èµ–é—®é¢˜ã€é…ç½®é”™è¯¯ã€æƒé™ä¸è¶³ã€ç«¯å£å†²çªã€ç¯å¢ƒå˜é‡ã€è·¯å¾„é”™è¯¯ã€è¶…æ—¶

ğŸ”¸ è§£å†³é—®é¢˜çš„ä¼˜å…ˆçº§ï¼š
   å®‰å…¨æ€§ â†’ åŠŸèƒ½æ€§ â†’ æ€§èƒ½ â†’ ä¾¿åˆ©æ€§
```

### 10.2 å…³é”®è¯Šæ–­å‘½ä»¤é€ŸæŸ¥


**ğŸ”§ æ ¸å¿ƒå‘½ä»¤æ¸…å•**ï¼š
```bash
# æœåŠ¡çŠ¶æ€è¯Šæ–­
systemctl status service-name    # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl --failed              # æŸ¥çœ‹æ‰€æœ‰å¤±è´¥æœåŠ¡
journalctl -u service-name      # æŸ¥çœ‹æœåŠ¡æ—¥å¿—

# é…ç½®æ–‡ä»¶æ£€æŸ¥  
systemctl cat service-name      # æŸ¥çœ‹æœåŠ¡é…ç½®
nginx -t                        # Nginxè¯­æ³•æ£€æŸ¥
apache2ctl configtest          # Apacheè¯­æ³•æ£€æŸ¥

# æƒé™å’Œè·¯å¾„æ£€æŸ¥
ls -la /path/to/file            # æ£€æŸ¥æ–‡ä»¶æƒé™
sudo -u username command        # æµ‹è¯•ç”¨æˆ·æƒé™
which command-name              # æŸ¥æ‰¾å‘½ä»¤è·¯å¾„

# ç½‘ç»œå’Œç«¯å£æ£€æŸ¥
sudo netstat -tulpn | grep :80  # æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :80               # æŸ¥çœ‹ç«¯å£ä½¿ç”¨è¿›ç¨‹
```

### 10.3 é—®é¢˜è§£å†³çš„æ€ç»´æ–¹æ³•


**ğŸ§  ç³»ç»Ÿæ€§æ€è€ƒæ¨¡å¼**ï¼š

**åˆ†å±‚è¯Šæ–­æ³•**ï¼š
```
åº”ç”¨å±‚ï¼šé…ç½®æ–‡ä»¶ã€åº”ç”¨é€»è¾‘
æœåŠ¡å±‚ï¼šsystemdé…ç½®ã€ä¾èµ–å…³ç³»  
ç³»ç»Ÿå±‚ï¼šæƒé™ã€ç«¯å£ã€è·¯å¾„
ç¡¬ä»¶å±‚ï¼šèµ„æºä¸è¶³ã€ç¡¬ä»¶æ•…éšœ
```

**æ’é™¤æ³•åŸåˆ™**ï¼š
```
ä»ç®€å•åˆ°å¤æ‚ï¼šå…ˆæ£€æŸ¥åŸºç¡€é—®é¢˜
ä»å¤–åˆ°å†…ï¼šå…ˆæ£€æŸ¥æ˜æ˜¾é”™è¯¯
ä»å·²çŸ¥åˆ°æœªçŸ¥ï¼šåŸºäºç»éªŒä¼˜å…ˆæ’æŸ¥
```

### 10.4 é¢„é˜²æ€§ç»´æŠ¤å»ºè®®


**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š

**é…ç½®ç®¡ç†**ï¼š
- ç‰ˆæœ¬æ§åˆ¶æ‰€æœ‰é…ç½®æ–‡ä»¶
- å»ºç«‹é…ç½®æ–‡ä»¶å¤‡ä»½æœºåˆ¶
- ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·æ ‡å‡†åŒ–éƒ¨ç½²

**ç›‘æ§é¢„è­¦**ï¼š
- å»ºç«‹æœåŠ¡å¥åº·æ£€æŸ¥
- è®¾ç½®å…³é”®æœåŠ¡ç›‘æ§å‘Šè­¦
- å®šæœŸæ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

**æ–‡æ¡£åŒ–**ï¼š
- è®°å½•æœåŠ¡é…ç½®å’Œä¾èµ–å…³ç³»
- å»ºç«‹æ•…éšœå¤„ç†çŸ¥è¯†åº“
- ç»´æŠ¤ç³»ç»Ÿæ¶æ„æ–‡æ¡£

### 10.5 å¸¸è§é™·é˜±ä¸é¿å…æ–¹æ³•


**âš ï¸ æ–°æ‰‹å¸¸çŠ¯é”™è¯¯**ï¼š

```
é”™è¯¯1ï¼šåªçœ‹è¡¨é¢ç°è±¡ï¼Œä¸æ·±å…¥åˆ†ææ—¥å¿—
æ­£ç¡®ï¼šè¯¦ç»†åˆ†æjournalctlå’Œåº”ç”¨æ—¥å¿—

é”™è¯¯2ï¼šç›²ç›®ä¿®æ”¹é…ç½®ï¼Œä¸å¤‡ä»½åŸæ–‡ä»¶  
æ­£ç¡®ï¼šä¿®æ”¹å‰å…ˆå¤‡ä»½ï¼Œæµ‹è¯•åå†åº”ç”¨

é”™è¯¯3ï¼šæƒé™è®¾ç½®è¿‡äºå®½æ¾ï¼ˆ777ï¼‰
æ­£ç¡®ï¼šéµå¾ªæœ€å°æƒé™åŸåˆ™

é”™è¯¯4ï¼šå¿½è§†æœåŠ¡ä¾èµ–å…³ç³»
æ­£ç¡®ï¼šç†è§£å¹¶æ­£ç¡®é…ç½®æœåŠ¡ä¾èµ–

é”™è¯¯5ï¼šè¶…æ—¶è®¾ç½®ä¸åˆç†
æ­£ç¡®ï¼šæ ¹æ®æœåŠ¡ç‰¹ç‚¹è®¾ç½®åˆé€‚è¶…æ—¶æ—¶é—´
```

### 10.6 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸš€ æ·±å…¥å­¦ä¹ å»ºè®®**ï¼š

**æŠ€æœ¯æ·±åŒ–**ï¼š
- æ·±å…¥å­¦ä¹ systemdé«˜çº§ç‰¹æ€§
- æŒæ¡æ€§èƒ½åˆ†æå·¥å…·ä½¿ç”¨
- å­¦ä¹ å®¹å™¨åŒ–æœåŠ¡ç®¡ç†

**å·¥å…·æŒæ¡**ï¼š
- straceç³»ç»Ÿè°ƒç”¨è·Ÿè¸ª
- perfæ€§èƒ½åˆ†æ
- æ—¥å¿—åˆ†æå·¥å…·

**è‡ªåŠ¨åŒ–è¿ç»´**ï¼š
- æœåŠ¡è‡ªåŠ¨åŒ–éƒ¨ç½²
- ç›‘æ§å‘Šè­¦ç³»ç»Ÿæ­å»º
- æ•…éšœè‡ªåŠ¨æ¢å¤æœºåˆ¶

**ğŸ¯ å®è·µå»ºè®®**ï¼š
- æ­å»ºæµ‹è¯•ç¯å¢ƒç»ƒä¹ æ•…éšœæ’æŸ¥
- å‚ä¸å¼€æºé¡¹ç›®ï¼Œæ¥è§¦çœŸå®é—®é¢˜
- å»ºç«‹ä¸ªäººæ•…éšœæ¡ˆä¾‹åº“
- ä¸åŒè¡Œäº¤æµç»éªŒå’ŒæŠ€å·§

### 10.7 åº”æ€¥å¤„ç†æ£€æŸ¥å•


**ğŸ†˜ ç´§æ€¥æ•…éšœå¤„ç†æµç¨‹**ï¼š
```
â–¡ ç¡®è®¤æ•…éšœå½±å“èŒƒå›´å’Œä¸¥é‡ç¨‹åº¦
â–¡ æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼šsystemctl status
â–¡ æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼šjournalctl -u service
â–¡ éªŒè¯åŸºç¡€æ¡ä»¶ï¼šç«¯å£ã€æƒé™ã€è·¯å¾„
â–¡ å°è¯•åŸºæœ¬ä¿®å¤ï¼šé‡å¯ã€é…ç½®ä¿®æ­£
â–¡ è®°å½•å¤„ç†è¿‡ç¨‹å’Œè§£å†³æ–¹æ¡ˆ
â–¡ éªŒè¯ä¿®å¤æ•ˆæœå’Œç³»ç»Ÿç¨³å®šæ€§
â–¡ åˆ†ææ ¹æœ¬åŸå› ï¼Œåˆ¶å®šé¢„é˜²æªæ–½
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æœåŠ¡å¯åŠ¨å¤±è´¥å¿…æœ‰åŸå› ï¼Œç³»ç»Ÿæ€§æ’æŸ¥æ˜¯å…³é”®
- æ—¥å¿—æ˜¯æœ€å¥½çš„æœ‹å‹ï¼Œè¯¦ç»†åˆ†æä¸å¯å°‘
- æƒé™ã€ç«¯å£ã€è·¯å¾„æ˜¯ä¸‰å¤§å¸¸è§é—®é¢˜æºå¤´
- é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯è¦ç»†å¿ƒæ£€æŸ¥
- è¶…æ—¶è®¾ç½®è¦æ ¹æ®æœåŠ¡ç‰¹ç‚¹åˆç†é…ç½®
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå¤‡ä»½æœºåˆ¶

æŒæ¡è¿™äº›çŸ¥è¯†å’Œæ–¹æ³•ï¼Œå°±èƒ½ä»å®¹åº”å¯¹å¤§éƒ¨åˆ†æœåŠ¡å¯åŠ¨å¤±è´¥çš„é—®é¢˜ï¼Œæˆä¸ºLinuxç³»ç»Ÿç®¡ç†çš„è¡Œå®¶é‡Œæ‰‹ï¼