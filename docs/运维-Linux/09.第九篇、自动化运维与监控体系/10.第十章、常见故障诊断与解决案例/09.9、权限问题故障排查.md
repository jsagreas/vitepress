---
title: 9ã€æƒé™é—®é¢˜æ•…éšœæ’æŸ¥
---
## ğŸ“š ç›®å½•

1. [æƒé™ä¸è¶³é”™è¯¯è¯Šæ–­](#1-æƒé™ä¸è¶³é”™è¯¯è¯Šæ–­)
2. [SELinuxä¸Šä¸‹æ–‡é”™è¯¯](#2-selinuxä¸Šä¸‹æ–‡é”™è¯¯)
3. [æ–‡ä»¶å±ä¸»å±ç»„å¼‚å¸¸](#3-æ–‡ä»¶å±ä¸»å±ç»„å¼‚å¸¸)
4. [sudoæƒé™é…ç½®é”™è¯¯](#4-sudoæƒé™é…ç½®é”™è¯¯)
5. [ç‰¹æ®Šæƒé™ä½å¼‚å¸¸](#5-ç‰¹æ®Šæƒé™ä½å¼‚å¸¸)
6. [ACLæƒé™å†²çªå¤„ç†](#6-aclæƒé™å†²çªå¤„ç†)
7. [ç”¨æˆ·ç»„æƒé™é—®é¢˜](#7-ç”¨æˆ·ç»„æƒé™é—®é¢˜)
8. [æƒé™ç»§æ‰¿é”™è¯¯ä¿®å¤](#8-æƒé™ç»§æ‰¿é”™è¯¯ä¿®å¤)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ æƒé™ä¸è¶³é”™è¯¯è¯Šæ–­


### 1.1 æƒé™é”™è¯¯çš„æœ¬è´¨ç†è§£


**ä»€ä¹ˆæ˜¯æƒé™ä¸è¶³**ï¼Ÿ
Linuxç³»ç»Ÿä¸­ï¼Œæƒé™ä¸è¶³å°±æ˜¯å½“å‰ç”¨æˆ·å¯¹æ–‡ä»¶æˆ–ç›®å½•æ²¡æœ‰æ‰§è¡Œæ“ä½œæ‰€éœ€çš„æƒé™ã€‚è¿™å°±åƒä½ æ²¡æœ‰æŸä¸ªæˆ¿é—´çš„é’¥åŒ™ï¼Œè‡ªç„¶æ— æ³•è¿›å…¥ã€‚

**å¸¸è§çš„æƒé™ä¸è¶³é”™è¯¯ä¿¡æ¯**ï¼š
- `Permission denied`ï¼šæ²¡æœ‰æ‰§è¡Œæƒé™
- `Access denied`ï¼šæ²¡æœ‰è®¿é—®æƒé™  
- `Operation not permitted`ï¼šæ“ä½œä¸è¢«å…è®¸

```
æƒé™æ£€æŸ¥æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚æ“ä½œæ–‡ä»¶ â†’ ç³»ç»Ÿæ£€æŸ¥ç”¨æˆ·èº«ä»½ â†’ æ£€æŸ¥æ–‡ä»¶æƒé™ â†’ å…è®¸/æ‹’ç»æ“ä½œ

å®é™…æ¡ˆä¾‹ï¼š
$ cat /etc/shadow
cat: /etc/shadow: Permission denied

åŸå› åˆ†æï¼š/etc/shadowæ–‡ä»¶åªæœ‰rootç”¨æˆ·å¯ä»¥è¯»å–
```

### 1.2 æƒé™è¯Šæ–­çš„ç³»ç»Ÿæ–¹æ³•


**ç¬¬ä¸€æ­¥ï¼šç¡®è®¤å½“å‰ç”¨æˆ·èº«ä»½**

ä½¿ç”¨ `whoami` å’Œ `id` å‘½ä»¤ç¡®è®¤å½“å‰ç”¨æˆ·ï¼š
- `whoami`ï¼šæ˜¾ç¤ºå½“å‰ç”¨æˆ·å
- `id`ï¼šæ˜¾ç¤ºç”¨æˆ·IDã€ç»„IDå’Œæ‰€å±ç»„

**ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™**

ä½¿ç”¨ `ls -l` æŸ¥çœ‹æ–‡ä»¶è¯¦ç»†æƒé™ï¼š

```
æ–‡ä»¶æƒé™æ ¼å¼è§£è¯»ï¼š
-rwxr-xr-x  1  root  root  1234  Jan 1 12:00  filename

ç¬¬1ä½ï¼šæ–‡ä»¶ç±»å‹ï¼ˆ- æ™®é€šæ–‡ä»¶ï¼Œd ç›®å½•ï¼‰
2-4ä½ï¼šæ‰€æœ‰è€…æƒé™ï¼ˆrwx = è¯»å†™æ‰§è¡Œï¼‰
5-7ä½ï¼šæ‰€å±ç»„æƒé™ï¼ˆr-x = è¯»å’Œæ‰§è¡Œï¼‰
8-10ä½ï¼šå…¶ä»–ç”¨æˆ·æƒé™ï¼ˆr-x = è¯»å’Œæ‰§è¡Œï¼‰
```

**ç¬¬ä¸‰æ­¥ï¼šåˆ†ææƒé™åŒ¹é…**

> ğŸ’¡ **å…³é”®ç†è§£**ï¼šLinuxæƒé™æ£€æŸ¥æŒ‰ç…§"æ‰€æœ‰è€… â†’ æ‰€å±ç»„ â†’ å…¶ä»–ç”¨æˆ·"çš„é¡ºåºè¿›è¡Œï¼Œä¸€æ—¦åŒ¹é…åˆ°æŸä¸ªèº«ä»½ï¼Œå°±åªä½¿ç”¨å¯¹åº”çš„æƒé™ä½ã€‚

### 1.3 å¸¸è§æƒé™ä¸è¶³æ¡ˆä¾‹


**æ¡ˆä¾‹1ï¼šè„šæœ¬æ— æ³•æ‰§è¡Œ**

```bash
# é—®é¢˜ç°è±¡
$ ./myscript.sh
bash: ./myscript.sh: Permission denied

# è¯Šæ–­æ­¥éª¤
$ ls -l myscript.sh
-rw-r--r-- 1 user user 145 Jan 1 12:00 myscript.sh

# é—®é¢˜åˆ†æï¼šæ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™ï¼ˆxä½ç¼ºå¤±ï¼‰
# è§£å†³æ–¹æ¡ˆ
$ chmod +x myscript.sh
```

**æ¡ˆä¾‹2ï¼šæ— æ³•è®¿é—®ç›®å½•**

```bash
# é—®é¢˜ç°è±¡
$ cd /home/anotheruser
bash: cd: /home/anotheruser: Permission denied

# è¯Šæ–­æ­¥éª¤  
$ ls -ld /home/anotheruser
drwxr-----  2  anotheruser  anotheruser  4096  Jan 1 12:00  /home/anotheruser

# é—®é¢˜åˆ†æï¼šç›®å½•å¯¹å…¶ä»–ç”¨æˆ·æ²¡æœ‰æ‰§è¡Œæƒé™
# æ³¨æ„ï¼šç›®å½•çš„æ‰§è¡Œæƒé™å†³å®šæ˜¯å¦èƒ½"è¿›å…¥"ç›®å½•
```

### 1.4 æƒé™è¯Šæ–­å®ç”¨æŠ€å·§


**ä½¿ç”¨ `namei` å‘½ä»¤è¿½è¸ªè·¯å¾„æƒé™**ï¼š

```bash
# æ£€æŸ¥å®Œæ•´è·¯å¾„çš„æƒé™é“¾
$ namei -l /home/user/data/file.txt
```

è¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤ºè·¯å¾„ä¸­æ¯ä¸€çº§ç›®å½•çš„æƒé™æƒ…å†µï¼Œå¸®åŠ©å®šä½æƒé™é—®é¢˜çš„ç¡®åˆ‡ä½ç½®ã€‚

> âš ï¸ **é‡è¦æé†’**ï¼šç›®å½•æƒé™å’Œæ–‡ä»¶æƒé™çš„å«ä¹‰ä¸åŒ
> - ç›®å½•çš„è¯»æƒé™ï¼šèƒ½åˆ—å‡ºç›®å½•å†…å®¹
> - ç›®å½•çš„å†™æƒé™ï¼šèƒ½åœ¨ç›®å½•ä¸­åˆ›å»ºã€åˆ é™¤æ–‡ä»¶
> - ç›®å½•çš„æ‰§è¡Œæƒé™ï¼šèƒ½è¿›å…¥ç›®å½•

---

## 2. ğŸ›¡ï¸ SELinuxä¸Šä¸‹æ–‡é”™è¯¯


### 2.1 SELinuxåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯SELinux**ï¼Ÿ
SELinuxï¼ˆSecurity-Enhanced Linuxï¼‰æ˜¯Linuxå†…æ ¸çš„å®‰å…¨æ¨¡å—ï¼Œå®ƒåœ¨ä¼ ç»Ÿçš„æ–‡ä»¶æƒé™åŸºç¡€ä¸Šå¢åŠ äº†é¢å¤–çš„å®‰å…¨ç­–ç•¥ã€‚å¯ä»¥æŠŠå®ƒç†è§£ä¸ºç»™æ¯ä¸ªæ–‡ä»¶å’Œè¿›ç¨‹éƒ½è´´ä¸Šäº†"æ ‡ç­¾"ï¼Œåªæœ‰æ ‡ç­¾åŒ¹é…çš„æ‰èƒ½ç›¸äº’è®¿é—®ã€‚

**SELinuxçš„ä¸‰ç§æ¨¡å¼**ï¼š
- **Enforcingï¼ˆå¼ºåˆ¶æ¨¡å¼ï¼‰**ï¼šä¸¥æ ¼æ‰§è¡ŒSELinuxç­–ç•¥
- **Permissiveï¼ˆå®½æ¾æ¨¡å¼ï¼‰**ï¼šè®°å½•è¿è§„ä½†ä¸é˜»æ­¢
- **Disabledï¼ˆç¦ç”¨æ¨¡å¼ï¼‰**ï¼šå®Œå…¨å…³é—­SELinux

```
SELinuxä¸Šä¸‹æ–‡æ ¼å¼ï¼š
user:role:type:level

ç¤ºä¾‹ï¼š
unconfined_u:object_r:admin_home_t:s0
â”‚           â”‚        â”‚           â”‚
ç”¨æˆ·        è§’è‰²      ç±»å‹        çº§åˆ«
```

### 2.2 SELinuxæ•…éšœè¯Šæ–­


**ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥SELinuxçŠ¶æ€**

```bash
# æŸ¥çœ‹SELinuxçŠ¶æ€
$ getenforce
Enforcing

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
$ sestatus
SELinux status:                 enabled
SELinuxfs mount:               /sys/fs/selinux
SELinux root directory:        /etc/selinux
Current mode:                  enforcing
```

**ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹æ–‡ä»¶ä¸Šä¸‹æ–‡**

```bash
# æŸ¥çœ‹æ–‡ä»¶çš„SELinuxä¸Šä¸‹æ–‡
$ ls -Z /var/www/html/index.html
-rw-r--r--. apache apache unconfined_u:object_r:httpd_exec_t:s0 index.html
```

**ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥å®¡è®¡æ—¥å¿—**

SELinuxè¿è§„ä¼šè®°å½•åœ¨ `/var/log/audit/audit.log` æˆ–ç³»ç»Ÿæ—¥å¿—ä¸­ï¼š

```bash
# æŸ¥çœ‹SELinuxç›¸å…³çš„å®¡è®¡æ—¥å¿—
$ ausearch -m avc -ts recent

# ä½¿ç”¨sealertå·¥å…·åˆ†æï¼ˆå¦‚æœå¯ç”¨ï¼‰
$ sealert -a /var/log/audit/audit.log
```

### 2.3 å¸¸è§SELinuxä¸Šä¸‹æ–‡é—®é¢˜


**æ¡ˆä¾‹1ï¼šWebæœåŠ¡å™¨æ–‡ä»¶ä¸Šä¸‹æ–‡é”™è¯¯**

```bash
# é—®é¢˜ç°è±¡ï¼šç½‘é¡µæ— æ³•è®¿é—®ï¼Œè¿”å›403é”™è¯¯
# ä½†æ–‡ä»¶æƒé™çœ‹èµ·æ¥æ­£å¸¸

# æ£€æŸ¥æ–‡ä»¶ä¸Šä¸‹æ–‡
$ ls -Z /var/www/html/test.html
-rw-r--r--. apache apache user_home_t /var/www/html/test.html

# é—®é¢˜åˆ†æï¼šæ–‡ä»¶ä¸Šä¸‹æ–‡æ˜¯user_home_tï¼Œä½†åº”è¯¥æ˜¯httpd_exec_t
# è¿™è¯´æ˜æ–‡ä»¶å¯èƒ½æ˜¯ä»ç”¨æˆ·å®¶ç›®å½•å¤åˆ¶è¿‡æ¥çš„

# è§£å†³æ–¹æ¡ˆ1ï¼šæ¢å¤é»˜è®¤ä¸Šä¸‹æ–‡
$ restorecon /var/www/html/test.html

# è§£å†³æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨è®¾ç½®æ­£ç¡®ä¸Šä¸‹æ–‡
$ chcon -t httpd_exec_t /var/www/html/test.html
```

**æ¡ˆä¾‹2ï¼šSSHå¯†é’¥æ–‡ä»¶ä¸Šä¸‹æ–‡é”™è¯¯**

```bash
# é—®é¢˜ç°è±¡ï¼šSSHå¯†é’¥è®¤è¯å¤±è´¥

# æ£€æŸ¥.sshç›®å½•å’Œæ–‡ä»¶çš„ä¸Šä¸‹æ–‡
$ ls -laZ ~/.ssh/
drwx------. user user unconfined_u:object_r:ssh_home_t:s0 .
-rw-------. user user unconfined_u:object_r:admin_home_t:s0 id_rsa

# é—®é¢˜åˆ†æï¼šç§é’¥æ–‡ä»¶ä¸Šä¸‹æ–‡åº”è¯¥æ˜¯ssh_home_tï¼Œä¸æ˜¯admin_home_t

# è§£å†³æ–¹æ¡ˆï¼šæ¢å¤æ­£ç¡®ä¸Šä¸‹æ–‡
$ restorecon -R ~/.ssh/
```

### 2.4 SELinuxä¸Šä¸‹æ–‡ä¿®å¤æ–¹æ³•


**æ–¹æ³•1ï¼šä½¿ç”¨restoreconæ¢å¤é»˜è®¤ä¸Šä¸‹æ–‡**

```bash
# æ¢å¤å•ä¸ªæ–‡ä»¶
$ restorecon /path/to/file

# é€’å½’æ¢å¤ç›®å½•
$ restorecon -R /path/to/directory

# æ˜¾ç¤ºå¤„ç†è¿‡ç¨‹
$ restorecon -v /path/to/file
```

**æ–¹æ³•2ï¼šä½¿ç”¨chconä¸´æ—¶ä¿®æ”¹ä¸Šä¸‹æ–‡**

```bash
# ä¸´æ—¶è®¾ç½®æ–‡ä»¶ç±»å‹
$ chcon -t httpd_exec_t /var/www/html/file

# å¤åˆ¶å¦ä¸€ä¸ªæ–‡ä»¶çš„ä¸Šä¸‹æ–‡
$ chcon --reference=/var/www/html/working_file /var/www/html/broken_file
```

> âš ï¸ **æ³¨æ„**ï¼š`chcon` çš„ä¿®æ”¹æ˜¯ä¸´æ—¶çš„ï¼Œç³»ç»Ÿé‡æ–°æ ‡è®°æ—¶å¯èƒ½ä¼šè¢«è¦†ç›–ã€‚`restorecon` ä½¿ç”¨ç­–ç•¥ä¸­å®šä¹‰çš„é»˜è®¤ä¸Šä¸‹æ–‡ï¼Œæ›´åŠ æŒä¹…ã€‚

---

## 3. ğŸ‘¤ æ–‡ä»¶å±ä¸»å±ç»„å¼‚å¸¸


### 3.1 å±ä¸»å±ç»„çš„ä½œç”¨æœºåˆ¶


**ä»€ä¹ˆæ˜¯æ–‡ä»¶å±ä¸»å’Œå±ç»„**ï¼Ÿ
- **å±ä¸»ï¼ˆOwnerï¼‰**ï¼šæ–‡ä»¶çš„æ‹¥æœ‰è€…ï¼Œé€šå¸¸æ˜¯åˆ›å»ºæ–‡ä»¶çš„ç”¨æˆ·
- **å±ç»„ï¼ˆGroupï¼‰**ï¼šæ–‡ä»¶æ‰€å±çš„ç”¨æˆ·ç»„

Linuxé€šè¿‡å±ä¸»å’Œå±ç»„æ¥ç¡®å®šè°å¯¹æ–‡ä»¶æœ‰ä»€ä¹ˆæƒé™ã€‚è¿™å°±åƒæˆ¿å­çš„æˆ¿ä¸»å’Œå®¶åº­æˆå‘˜çš„å…³ç³»ã€‚

```
æƒé™åˆ¤æ–­é¡ºåºï¼š
1. å¦‚æœå½“å‰ç”¨æˆ·æ˜¯æ–‡ä»¶å±ä¸» â†’ ä½¿ç”¨å±ä¸»æƒé™ä½
2. å¦‚æœå½“å‰ç”¨æˆ·å±äºæ–‡ä»¶å±ç»„ â†’ ä½¿ç”¨å±ç»„æƒé™ä½  
3. å¦åˆ™ â†’ ä½¿ç”¨å…¶ä»–ç”¨æˆ·æƒé™ä½
```

### 3.2 å±ä¸»å±ç»„å¼‚å¸¸çš„å¸¸è§æƒ…å†µ


**æƒ…å†µ1ï¼šæ–‡ä»¶å±ä¸»ä¸å­˜åœ¨**

å½“ç”¨æˆ·è¢«åˆ é™¤åï¼Œå…¶æ–‡ä»¶çš„å±ä¸»ä¼šæ˜¾ç¤ºä¸ºæ•°å­—IDï¼š

```bash
# å¼‚å¸¸ç°è±¡
$ ls -l /home/
drwx------  5  1001  1001  4096  Jan 1 12:00  olduser_home

# è¿™è¡¨ç¤ºUIDä¸º1001çš„ç”¨æˆ·å·²è¢«åˆ é™¤ï¼Œä½†æ–‡ä»¶ä»ç„¶å­˜åœ¨
```

**æƒ…å†µ2ï¼šæ–‡ä»¶å±ç»„ä¸å­˜åœ¨**

ç±»ä¼¼åœ°ï¼Œå½“ç”¨æˆ·ç»„è¢«åˆ é™¤åï¼š

```bash
# å¼‚å¸¸ç°è±¡  
$ ls -l somefile
-rw-r--r--  1  user  1005  1234  Jan 1 12:00  somefile

# è¿™è¡¨ç¤ºGIDä¸º1005çš„ç”¨æˆ·ç»„å·²è¢«åˆ é™¤
```

**æƒ…å†µ3ï¼šå±ä¸»å±ç»„ä¸åŒ¹é…é¢„æœŸ**

æ–‡ä»¶çš„å±ä¸»å±ç»„ä¸é¢„æœŸä¸ç¬¦ï¼Œé€šå¸¸å‘ç”Ÿåœ¨ï¼š
- æ–‡ä»¶ä»å…¶ä»–ç³»ç»Ÿå¤åˆ¶è¿‡æ¥
- ä½¿ç”¨äº†é”™è¯¯çš„æ–¹å¼åˆ›å»ºæˆ–ç§»åŠ¨æ–‡ä»¶
- ç³»ç»Ÿç®¡ç†å‘˜æ“ä½œé”™è¯¯

### 3.3 å±ä¸»å±ç»„é—®é¢˜è¯Šæ–­


**è¯Šæ–­å·¥å…·å’Œå‘½ä»¤**ï¼š

```bash
# æŸ¥çœ‹æ–‡ä»¶çš„è¯¦ç»†å±ä¸»å±ç»„ä¿¡æ¯
$ ls -l filename
$ stat filename

# æŸ¥çœ‹ç³»ç»Ÿä¸­çš„ç”¨æˆ·å’Œç»„
$ cat /etc/passwd    # æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
$ cat /etc/group     # æŸ¥çœ‹ç»„åˆ—è¡¨

# æŸ¥æ‰¾å±ä¸»ä¸ºç‰¹å®šç”¨æˆ·çš„æ–‡ä»¶
$ find /path -user username

# æŸ¥æ‰¾å±ç»„ä¸ºç‰¹å®šç»„çš„æ–‡ä»¶
$ find /path -group groupname

# æŸ¥æ‰¾å­¤å„¿æ–‡ä»¶ï¼ˆå±ä¸»ä¸å­˜åœ¨ï¼‰
$ find /path -nouser

# æŸ¥æ‰¾å­¤å„¿æ–‡ä»¶ï¼ˆå±ç»„ä¸å­˜åœ¨ï¼‰
$ find /path -nogroup
```

### 3.4 å±ä¸»å±ç»„ä¿®å¤æ–¹æ³•


**ä½¿ç”¨chownå‘½ä»¤ä¿®æ”¹å±ä¸»**ï¼š

```bash
# åªä¿®æ”¹å±ä¸»
$ chown newowner filename

# åŒæ—¶ä¿®æ”¹å±ä¸»å’Œå±ç»„
$ chown newowner:newgroup filename

# åªä¿®æ”¹å±ç»„ï¼ˆä¹Ÿå¯ä»¥ç”¨chgrpï¼‰
$ chown :newgroup filename

# é€’å½’ä¿®æ”¹ç›®å½•
$ chown -R newowner:newgroup directory/
```

**å®é™…æ¡ˆä¾‹ä¿®å¤**ï¼š

```bash
# æ¡ˆä¾‹ï¼šæ¢å¤è¢«åˆ é™¤ç”¨æˆ·çš„å®¶ç›®å½•
# 1. åˆ›å»ºæ–°ç”¨æˆ·
$ useradd -u 1001 newuser

# 2. ä¿®æ”¹å®¶ç›®å½•å±ä¸»
$ chown -R newuser:newuser /home/olduser_home

# 3. é‡å‘½åç›®å½•ï¼ˆå¯é€‰ï¼‰
$ mv /home/olduser_home /home/newuser
```

> ğŸ’¡ **å°æŠ€å·§**ï¼šä½¿ç”¨ `--reference` é€‰é¡¹å¯ä»¥å¤åˆ¶å¦ä¸€ä¸ªæ–‡ä»¶çš„å±ä¸»å±ç»„
```bash
$ chown --reference=template_file target_file
```

---

## 4. âš™ï¸ sudoæƒé™é…ç½®é”™è¯¯


### 4.1 sudoå·¥ä½œåŸç†


**sudoæ˜¯ä»€ä¹ˆ**ï¼Ÿ
sudoï¼ˆSuper User Doï¼‰å…è®¸æ™®é€šç”¨æˆ·ä¸´æ—¶è·å¾—è¶…çº§ç”¨æˆ·æƒé™æ‰§è¡Œç‰¹å®šå‘½ä»¤ã€‚è¿™å°±åƒä¸´æ—¶å€Ÿç”¨ç®¡ç†å‘˜çš„é’¥åŒ™ã€‚

**sudoçš„é…ç½®æ–‡ä»¶**ï¼š
- ä¸»é…ç½®æ–‡ä»¶ï¼š`/etc/sudoers`
- é™„åŠ é…ç½®ç›®å½•ï¼š`/etc/sudoers.d/`

> âš ï¸ **é‡è¦è­¦å‘Š**ï¼šæ°¸è¿œä¸è¦ç›´æ¥ç¼–è¾‘ `/etc/sudoers` æ–‡ä»¶ï¼Œå¿…é¡»ä½¿ç”¨ `visudo` å‘½ä»¤ï¼

```
sudoæƒé™æ£€æŸ¥æµç¨‹ï¼š
ç”¨æˆ·æ‰§è¡Œsudoå‘½ä»¤ â†’ æ£€æŸ¥/etc/sudoersé…ç½® â†’ éªŒè¯ç”¨æˆ·å¯†ç  â†’ æ‰§è¡Œå‘½ä»¤
```

### 4.2 å¸¸è§sudoé…ç½®é—®é¢˜


**é—®é¢˜1ï¼šç”¨æˆ·ä¸åœ¨sudoersæ–‡ä»¶ä¸­**

```bash
# é”™è¯¯ç°è±¡
$ sudo ls
user is not in the sudoers file. This incident will be reported.

# è§£å†³æ–¹æ³•ï¼šå°†ç”¨æˆ·æ·»åŠ åˆ°sudoç»„
$ usermod -aG sudo username    # Debian/Ubuntuç³»ç»Ÿ
$ usermod -aG wheel username   # CentOS/RHELç³»ç»Ÿ
```

**é—®é¢˜2ï¼šsudoersæ–‡ä»¶è¯­æ³•é”™è¯¯**

å¦‚æœ `/etc/sudoers` æ–‡ä»¶æœ‰è¯­æ³•é”™è¯¯ï¼Œsudoå¯èƒ½å®Œå…¨æ— æ³•å·¥ä½œï¼š

```bash
# æ£€æŸ¥sudoersæ–‡ä»¶è¯­æ³•
$ visudo -c
/etc/sudoers: parsed OK

# å¦‚æœæœ‰è¯­æ³•é”™è¯¯ï¼Œvisudoä¼šæç¤ºå…·ä½“ä½ç½®
```

**é—®é¢˜3ï¼šç”¨æˆ·æƒé™é…ç½®è¿‡äºä¸¥æ ¼**

```bash
# ç¤ºä¾‹ï¼šç”¨æˆ·åªèƒ½æ‰§è¡Œç‰¹å®šå‘½ä»¤
username ALL=(ALL) /bin/ls, /bin/cat

# å½“ç”¨æˆ·å°è¯•æ‰§è¡Œå…¶ä»–å‘½ä»¤æ—¶ï¼š
$ sudo vim /etc/hosts
Sorry, user username is not allowed to run '/usr/bin/vim /etc/hosts' on hostname.
```

### 4.3 sudoersé…ç½®è¯¦è§£


**åŸºæœ¬è¯­æ³•æ ¼å¼**ï¼š
```
ç”¨æˆ·/ç»„  ä¸»æœº=(è¿è¡Œèº«ä»½)  å‘½ä»¤åˆ—è¡¨
```

**å¸¸ç”¨é…ç½®ç¤ºä¾‹**ï¼š

```bash
# å…è®¸ç”¨æˆ·æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
username ALL=(ALL:ALL) ALL

# å…è®¸ç”¨æˆ·ç»„æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
%groupname ALL=(ALL:ALL) ALL

# å…è®¸ç”¨æˆ·æ‰§è¡Œç‰¹å®šå‘½ä»¤ï¼Œæ— éœ€å¯†ç 
username ALL=(ALL) NOPASSWD: /bin/systemctl, /bin/mount

# å…è®¸ç”¨æˆ·ä»¥ç‰¹å®šç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤
username ALL=(apache) /usr/bin/php

# ä½¿ç”¨åˆ«åç®€åŒ–é…ç½®
Cmnd_Alias SERVICES = /bin/systemctl, /sbin/service
username ALL=(ALL) SERVICES
```

### 4.4 sudoæ•…éšœæ’æŸ¥æŠ€å·§


**æŸ¥çœ‹sudoæ—¥å¿—**ï¼š

```bash
# sudoæ“ä½œä¼šè®°å½•åœ¨ç³»ç»Ÿæ—¥å¿—ä¸­
$ grep sudo /var/log/auth.log    # Debian/Ubuntu
$ grep sudo /var/log/secure      # CentOS/RHEL
```

**æµ‹è¯•sudoé…ç½®**ï¼š

```bash
# ä»¥ç‰¹å®šç”¨æˆ·èº«ä»½æµ‹è¯•sudo
$ sudo -u username -l    # åˆ—å‡ºç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„sudoå‘½ä»¤

# éªŒè¯æŸä¸ªå‘½ä»¤æ˜¯å¦è¢«å…è®¸
$ sudo -l -U username    # ç®¡ç†å‘˜æ£€æŸ¥ç”¨æˆ·æƒé™
```

**æ¢å¤sudoæƒé™çš„ç´§æ€¥æ–¹æ³•**ï¼š

å¦‚æœsudoé…ç½®å‡ºé”™å¯¼è‡´æ— æ³•ä½¿ç”¨sudoï¼Œå¯ä»¥ï¼š

1. **ä½¿ç”¨rootè´¦æˆ·**ï¼ˆå¦‚æœå¯ä»¥ç›´æ¥ç™»å½•ï¼‰
2. **é€šè¿‡rescueæ¨¡å¼æˆ–å•ç”¨æˆ·æ¨¡å¼**
3. **ä½¿ç”¨å…¶ä»–æœ‰sudoæƒé™çš„ç”¨æˆ·**

---

## 5. ğŸ” ç‰¹æ®Šæƒé™ä½å¼‚å¸¸


### 5.1 ç‰¹æ®Šæƒé™ä½æ¦‚è¿°


Linuxé™¤äº†åŸºæœ¬çš„rwxæƒé™å¤–ï¼Œè¿˜æœ‰ä¸‰ç§ç‰¹æ®Šæƒé™ï¼š

**SUIDï¼ˆSet User IDï¼‰**ï¼š
- ä½ç½®ï¼šå±ä¸»æ‰§è¡Œæƒé™ä½ï¼ˆsæˆ–Sï¼‰
- ä½œç”¨ï¼šæ‰§è¡Œæ–‡ä»¶æ—¶ä¸´æ—¶è·å¾—æ–‡ä»¶å±ä¸»çš„æƒé™
- å…¸å‹åº”ç”¨ï¼š`passwd` å‘½ä»¤

**SGIDï¼ˆSet Group IDï¼‰**ï¼š
- ä½ç½®ï¼šå±ç»„æ‰§è¡Œæƒé™ä½ï¼ˆsæˆ–Sï¼‰
- ä½œç”¨ï¼šæ‰§è¡Œæ–‡ä»¶æ—¶ä¸´æ—¶è·å¾—æ–‡ä»¶å±ç»„çš„æƒé™ï¼Œæˆ–ç›®å½•ä¸­æ–°å»ºæ–‡ä»¶ç»§æ‰¿ç›®å½•çš„å±ç»„
- å…¸å‹åº”ç”¨ï¼šåä½œç›®å½•

**Sticky Bitï¼ˆç²˜æ»ä½ï¼‰**ï¼š
- ä½ç½®ï¼šå…¶ä»–ç”¨æˆ·æ‰§è¡Œæƒé™ä½ï¼ˆtæˆ–Tï¼‰
- ä½œç”¨ï¼šåœ¨ç›®å½•ä¸Šè®¾ç½®ï¼Œåªæœ‰æ–‡ä»¶æ‰€æœ‰è€…æ‰èƒ½åˆ é™¤å…¶æ–‡ä»¶
- å…¸å‹åº”ç”¨ï¼š`/tmp` ç›®å½•

```
ç‰¹æ®Šæƒé™çš„æ•°å­—è¡¨ç¤ºï¼š
4 = SUID
2 = SGID  
1 = Sticky Bit

ç¤ºä¾‹ï¼šchmod 4755 filename  # è®¾ç½®SUID + 755æƒé™
```

### 5.2 ç‰¹æ®Šæƒé™å¼‚å¸¸é—®é¢˜


**é—®é¢˜1ï¼šSUIDæƒé™è¢«æ„å¤–ç§»é™¤**

```bash
# æ¡ˆä¾‹ï¼špasswdå‘½ä»¤æ— æ³•å·¥ä½œ
$ passwd
passwd: Authentication token manipulation error

# æ£€æŸ¥passwdçš„æƒé™
$ ls -l /usr/bin/passwd
-rwxr-xr-x  1  root  root  54256  Jan 1 12:00  /usr/bin/passwd

# é—®é¢˜ï¼šç¼ºå°‘SUIDæƒé™ï¼Œåº”è¯¥æ˜¯-rwsr-xr-x
# ä¿®å¤ï¼š
$ sudo chmod u+s /usr/bin/passwd
```

**é—®é¢˜2ï¼šSGIDç›®å½•æƒé™è®¾ç½®é”™è¯¯**

```bash
# åä½œç›®å½•çš„æ­£ç¡®è®¾ç½®
$ mkdir /shared/project
$ chown root:developers /shared/project
$ chmod g+s /shared/project    # è®¾ç½®SGID
$ chmod 775 /shared/project    # è®¾ç½®åŸºæœ¬æƒé™

# éªŒè¯ï¼šåœ¨ç›®å½•ä¸­åˆ›å»ºçš„æ–‡ä»¶ä¼šè‡ªåŠ¨ç»§æ‰¿developersç»„
$ touch /shared/project/testfile
$ ls -l /shared/project/testfile
-rw-r--r--  1  user  developers  0  Jan 1 12:00  testfile
```

**é—®é¢˜3ï¼šSticky Bitè®¾ç½®ä¸å½“**

```bash
# /tmpç›®å½•çš„æ­£ç¡®æƒé™åº”è¯¥åŒ…å«sticky bit
$ ls -ld /tmp
drwxrwxrwt  12  root  root  4096  Jan 1 12:00  /tmp

# å¦‚æœsticky bitä¸¢å¤±ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥åˆ é™¤å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶
# ä¿®å¤ï¼š
$ sudo chmod +t /tmp
```

### 5.3 ç‰¹æ®Šæƒé™çš„å®‰å…¨è€ƒè™‘


> âš ï¸ **å®‰å…¨è­¦å‘Š**ï¼šSUIDå’ŒSGIDæƒé™å…·æœ‰å®‰å…¨é£é™©ï¼Œåº”è¯¥è°¨æ…è®¾ç½®

**å®‰å…¨å®¡è®¡æŠ€å·§**ï¼š

```bash
# æŸ¥æ‰¾ç³»ç»Ÿä¸­æ‰€æœ‰SUIDæ–‡ä»¶
$ find / -perm -4000 -type f 2>/dev/null

# æŸ¥æ‰¾æ‰€æœ‰SGIDæ–‡ä»¶  
$ find / -perm -2000 -type f 2>/dev/null

# æŸ¥æ‰¾å¯ç–‘çš„ç‰¹æ®Šæƒé™æ–‡ä»¶
$ find / \( -perm -4000 -o -perm -2000 \) -type f -exec ls -l {} \;
```

**ç‰¹æ®Šæƒé™çš„æ­£ç¡®ä½¿ç”¨**ï¼š

| æƒé™ç±»å‹ | **ä½¿ç”¨åœºæ™¯** | **è®¾ç½®å‘½ä»¤** | **å®‰å…¨è€ƒè™‘** |
|---------|-------------|-------------|-------------|
| SUID | éœ€è¦ä¸´æ—¶ææƒçš„ç³»ç»Ÿå·¥å…· | `chmod u+s` | ä¸¥æ ¼æ§åˆ¶ï¼Œå®šæœŸå®¡è®¡ |
| SGID | åä½œç›®å½•ï¼Œå…±äº«æ–‡ä»¶ | `chmod g+s` | ç¡®ä¿ç»„æˆå‘˜å¯ä¿¡ |
| Sticky | å…¬å…±ç›®å½•ï¼ˆå¦‚/tmpï¼‰ | `chmod +t` | é˜²æ­¢æ–‡ä»¶è¢«è¯¯åˆ  |

---

## 6. ğŸ“‹ ACLæƒé™å†²çªå¤„ç†


### 6.1 ACLæƒé™åŸºç¡€


**ä»€ä¹ˆæ˜¯ACL**ï¼Ÿ
ACLï¼ˆAccess Control Listï¼‰æ˜¯ä¼ ç»ŸLinuxæƒé™çš„æ‰©å±•ï¼Œå…è®¸ä¸ºç‰¹å®šç”¨æˆ·æˆ–ç»„è®¾ç½®æ›´ç²¾ç»†çš„æƒé™æ§åˆ¶ã€‚å¦‚æœè¯´ä¼ ç»Ÿæƒé™æ˜¯"ä¸€æŠŠé”é…ä¸‰æŠŠé’¥åŒ™"ï¼Œé‚£ä¹ˆACLå°±æ˜¯"æ™ºèƒ½é”ï¼Œå¯ä»¥ç»™ä¸åŒçš„äººé…ä¸åŒçš„æƒé™"ã€‚

**ACLçš„ä¼˜åŠ¿**ï¼š
- å¯ä»¥ä¸ºå¤šä¸ªç”¨æˆ·è®¾ç½®ä¸åŒæƒé™
- å¯ä»¥ä¸ºå¤šä¸ªç»„è®¾ç½®ä¸åŒæƒé™
- æ›´çµæ´»çš„æƒé™æ§åˆ¶

```
ACLæƒé™æ£€æŸ¥é¡ºåºï¼š
1. æ–‡ä»¶æ‰€æœ‰è€…æƒé™
2. å‘½åç”¨æˆ·æƒé™ï¼ˆACLä¸­çš„ç”¨æˆ·ï¼‰
3. æ–‡ä»¶æ‰€å±ç»„æƒé™æˆ–å‘½åç»„æƒé™ï¼ˆå–è¾ƒå¤§å€¼ï¼‰
4. å…¶ä»–ç”¨æˆ·æƒé™
```

### 6.2 ACLæƒé™æ“ä½œ


**æŸ¥çœ‹ACLæƒé™**ï¼š

```bash
# æŸ¥çœ‹æ–‡ä»¶çš„ACLæƒé™
$ getfacl filename

# è¾“å‡ºç¤ºä¾‹ï¼š
# file: filename
# owner: user1
# group: group1
user::rw-
user:user2:r--
group::r--
mask::r--
other::---
```

**è®¾ç½®ACLæƒé™**ï¼š

```bash
# ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®æƒé™
$ setfacl -m u:username:rw filename

# ä¸ºç‰¹å®šç»„è®¾ç½®æƒé™
$ setfacl -m g:groupname:r filename

# è®¾ç½®é»˜è®¤ACLï¼ˆåªå¯¹ç›®å½•æœ‰æ•ˆï¼‰
$ setfacl -d -m u:username:rwx directory/

# é€’å½’è®¾ç½®ACL
$ setfacl -R -m u:username:rw directory/
```

**åˆ é™¤ACLæƒé™**ï¼š

```bash
# åˆ é™¤ç‰¹å®šç”¨æˆ·çš„ACLæƒé™
$ setfacl -x u:username filename

# åˆ é™¤æ‰€æœ‰ACLæƒé™
$ setfacl -b filename
```

### 6.3 ACLæƒé™å†²çªè¯Šæ–­


**å†²çª1ï¼šmaskå€¼é™åˆ¶äº†æœ‰æ•ˆæƒé™**

ACLä¸­çš„maskå€¼é™åˆ¶äº†é™¤æ‰€æœ‰è€…å’Œå…¶ä»–ç”¨æˆ·å¤–çš„æœ€å¤§æœ‰æ•ˆæƒé™ï¼š

```bash
# æŸ¥çœ‹ACL
$ getfacl testfile
user::rw-
user:alice:rwx    # Aliceè¢«è®¾ç½®äº†rwxæƒé™
mask::r--         # ä½†maskåªå…è®¸ræƒé™
other::---

# å®é™…ä¸ŠAliceåªæœ‰ræƒé™ï¼Œå› ä¸ºè¢«maské™åˆ¶äº†
# ä¿®å¤ï¼šè°ƒæ•´maskå€¼
$ setfacl -m m::rwx testfile
```

**å†²çª2ï¼šä¼ ç»Ÿæƒé™ä¸ACLæƒé™ä¸ä¸€è‡´**

```bash
# ä½¿ç”¨chmodä¿®æ”¹æƒé™å¯èƒ½ä¼šå½±å“ACL
$ ls -l testfile
-rw-r--r--+ 1 user group 100 Jan 1 12:00 testfile    # æ³¨æ„+å·è¡¨ç¤ºæœ‰ACL

$ chmod 600 testfile    # ä¿®æ”¹ä¼ ç»Ÿæƒé™
$ getfacl testfile      # ACLçš„maskå€¼å¯èƒ½è¢«è‡ªåŠ¨è°ƒæ•´
```

### 6.4 ACLæƒé™å†²çªè§£å†³


**è§£å†³ç­–ç•¥1ï¼šç†è§£æƒé™ä¼˜å…ˆçº§**

```bash
# ç¤ºä¾‹ï¼šç”¨æˆ·æ—¢æ˜¯æ–‡ä»¶æ‰€æœ‰è€…ï¼Œåˆåœ¨ACLä¸­è¢«å•ç‹¬è®¾ç½®
# æ–‡ä»¶æ‰€æœ‰è€…æƒé™ä¼˜å…ˆäºACLä¸­çš„å‘½åç”¨æˆ·æƒé™

$ getfacl testfile
user::rw-           # æ‰€æœ‰è€…æƒé™
user:owner:r--      # å³ä½¿åœ¨ACLä¸­è®¾ç½®ï¼Œä¹Ÿä¸ä¼šç”Ÿæ•ˆ
group::r--
other::---
```

**è§£å†³ç­–ç•¥2ï¼šæ­£ç¡®è®¾ç½®é»˜è®¤ACL**

å¯¹äºç›®å½•ï¼Œè®¾ç½®é»˜è®¤ACLå¯ä»¥ç¡®ä¿æ–°å»ºæ–‡ä»¶ç»§æ‰¿æ­£ç¡®çš„æƒé™ï¼š

```bash
# è®¾ç½®ç›®å½•çš„è®¿é—®ACLå’Œé»˜è®¤ACL
$ setfacl -m u:alice:rwx,d:u:alice:rw /shared/project

# éªŒè¯æ–°å»ºæ–‡ä»¶æ˜¯å¦ç»§æ‰¿äº†æ­£ç¡®çš„ACL
$ touch /shared/project/newfile
$ getfacl /shared/project/newfile
```

**è§£å†³ç­–ç•¥3ï¼šä½¿ç”¨ACLç»§æ‰¿å¤„ç†å¤æ‚æƒé™éœ€æ±‚**

```bash
# ä¸ºé¡¹ç›®ç›®å½•è®¾ç½®å¤æ‚çš„æƒé™ç»“æ„
$ mkdir /project
$ setfacl -m u::rwx,g::r-x,o::--- /project                    # åŸºç¡€æƒé™
$ setfacl -m u:manager:rwx,u:developer:rw-,u:tester:r-- /project  # ç”¨æˆ·æƒé™
$ setfacl -d -m u::rwx,g::r-x,o::--- /project                 # é»˜è®¤æƒé™
$ setfacl -d -m u:manager:rwx,u:developer:rw-,u:tester:r-- /project
```

---

## 7. ğŸ‘¥ ç”¨æˆ·ç»„æƒé™é—®é¢˜


### 7.1 ç”¨æˆ·ç»„æƒé™æœºåˆ¶


**ç”¨æˆ·ç»„çš„ä½œç”¨**ï¼š
ç”¨æˆ·ç»„æ˜¯Linuxæƒé™ç®¡ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå…è®¸å°†å¤šä¸ªç”¨æˆ·ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç»Ÿä¸€åˆ†é…æƒé™ã€‚è¿™å°±åƒå…¬å¸é‡Œçš„éƒ¨é—¨ï¼ŒåŒä¸€ä¸ªéƒ¨é—¨çš„å‘˜å·¥æœ‰ç›¸ä¼¼çš„æƒé™ã€‚

**ç”¨æˆ·ç»„åˆ†ç±»**ï¼š
- **ä¸»ç»„ï¼ˆPrimary Groupï¼‰**ï¼šç”¨æˆ·çš„é»˜è®¤ç»„ï¼Œåœ¨ `/etc/passwd` ä¸­å®šä¹‰
- **é™„åŠ ç»„ï¼ˆSupplementary Groupsï¼‰**ï¼šç”¨æˆ·é¢å¤–åŠ å…¥çš„ç»„ï¼Œåœ¨ `/etc/group` ä¸­å®šä¹‰

```
ç”¨æˆ·ç»„æƒé™æ£€æŸ¥ï¼š
ç³»ç»Ÿæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å±äºæ–‡ä»¶çš„å±ç»„ â†’ å¦‚æœæ˜¯ï¼Œä½¿ç”¨ç»„æƒé™ä½ â†’ å¦‚æœä¸æ˜¯ï¼Œä½¿ç”¨å…¶ä»–ç”¨æˆ·æƒé™ä½
```

### 7.2 å¸¸è§ç”¨æˆ·ç»„æƒé™é—®é¢˜


**é—®é¢˜1ï¼šç”¨æˆ·ä¸åœ¨é¢„æœŸçš„ç»„ä¸­**

```bash
# æ£€æŸ¥ç”¨æˆ·æ‰€å±çš„ç»„
$ groups username
username : username dialout cdrom floppy audio dip video plugdev netdev

# æˆ–è€…ä½¿ç”¨idå‘½ä»¤æŸ¥çœ‹æ›´è¯¦ç»†ä¿¡æ¯
$ id username
uid=1000(username) gid=1000(username) groups=1000(username),20(dialout)...

# å¦‚æœç”¨æˆ·ä¸åœ¨éœ€è¦çš„ç»„ä¸­ï¼Œéœ€è¦æ·»åŠ 
$ usermod -aG groupname username
```

**é—®é¢˜2ï¼šç”¨æˆ·åœ¨ç»„ä¸­ä½†æƒé™ä»ç„¶ä¸è¶³**

è¿™é€šå¸¸æ˜¯å› ä¸ºç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•æ¥è·å¾—æ–°çš„ç»„æƒé™ï¼š

```bash
# å½“å‰ä¼šè¯æ£€æŸ¥ç»„æˆå‘˜èº«ä»½
$ id
uid=1000(user) gid=1000(user) groups=1000(user),27(sudo)

# å¦‚æœåˆšè¢«æ·»åŠ åˆ°æ–°ç»„ï¼Œå½“å‰ä¼šè¯å¯èƒ½çœ‹ä¸åˆ°
# è§£å†³æ–¹æ³•ï¼š
1. é‡æ–°ç™»å½•
2. ä½¿ç”¨ newgrp å‘½ä»¤ä¸´æ—¶åˆ‡æ¢åˆ°æ–°ç»„
$ newgrp groupname
```

**é—®é¢˜3ï¼šç»„æƒé™è®¾ç½®ä¸å½“**

```bash
# æ£€æŸ¥æ–‡ä»¶çš„ç»„æƒé™
$ ls -l /shared/data
-rw-r----- 1 root developers 1234 Jan 1 12:00 data.txt

# å¦‚æœdevelopersç»„æˆå‘˜æ— æ³•å†™å…¥ï¼Œæ£€æŸ¥ï¼š
1. ç”¨æˆ·æ˜¯å¦åœ¨developersç»„ä¸­
2. æ–‡ä»¶ç»„æƒé™æ˜¯å¦åŒ…å«å†™æƒé™ï¼ˆwï¼‰
3. ç›®å½•æ˜¯å¦æœ‰æ‰§è¡Œæƒé™ï¼ˆå…è®¸è®¿é—®ï¼‰
```

### 7.3 ç”¨æˆ·ç»„ç®¡ç†æœ€ä½³å®è·µ


**åˆ›å»ºåŠŸèƒ½æ€§ç”¨æˆ·ç»„**ï¼š

```bash
# ä¸ºç‰¹å®šåŠŸèƒ½åˆ›å»ºç»„
$ groupadd webdevelopers      # Webå¼€å‘ç»„
$ groupadd dbadmins          # æ•°æ®åº“ç®¡ç†ç»„
$ groupadd backupusers       # å¤‡ä»½æ“ä½œç»„

# å°†ç”¨æˆ·æ·»åŠ åˆ°å¯¹åº”ç»„
$ usermod -aG webdevelopers alice
$ usermod -aG dbadmins bob
$ usermod -aG backupusers charlie
```

**è®¾ç½®ç»„å…±äº«ç›®å½•**ï¼š

```bash
# åˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®é€‚å½“æƒé™
$ mkdir /shared/webdev
$ chown root:webdevelopers /shared/webdev
$ chmod 2775 /shared/webdev    # åŒ…å«SGIDä½ï¼Œç¡®ä¿æ–°æ–‡ä»¶ç»§æ‰¿ç»„

# éªŒè¯è®¾ç½®
$ ls -ld /shared/webdev
drwxrwsr-x 2 root webdevelopers 4096 Jan 1 12:00 /shared/webdev
```

### 7.4 ç”¨æˆ·ç»„æƒé™æ•…éšœæ’æŸ¥


**æ’æŸ¥å·¥å…·å’ŒæŠ€å·§**ï¼š

```bash
# æŸ¥çœ‹ç³»ç»Ÿä¸­æ‰€æœ‰ç»„
$ cat /etc/group

# æŸ¥æ‰¾ç‰¹å®šç»„çš„æˆå‘˜
$ getent group groupname

# æŸ¥çœ‹ç”¨æˆ·çš„æ‰€æœ‰ç»„ï¼ˆåŒ…æ‹¬ä¸»ç»„å’Œé™„åŠ ç»„ï¼‰
$ id -Gn username

# æŸ¥æ‰¾å±äºç‰¹å®šç»„çš„æ–‡ä»¶
$ find /path -group groupname

# ä¸´æ—¶åˆ‡æ¢ç”¨æˆ·çš„ä¸»ç»„ï¼ˆç”¨äºæµ‹è¯•ï¼‰
$ newgrp groupname
```

**ç”¨æˆ·ç»„æƒé™é—®é¢˜çš„ç³»ç»Ÿæ€§è§£å†³**ï¼š

1. **ç¡®è®¤ç”¨æˆ·ç»„æˆå‘˜èº«ä»½**ï¼šä½¿ç”¨ `id` å’Œ `groups` å‘½ä»¤
2. **æ£€æŸ¥æ–‡ä»¶ç»„æƒé™**ï¼šä½¿ç”¨ `ls -l` æŸ¥çœ‹ç»„æƒé™ä½
3. **éªŒè¯ç›®å½•æƒé™é“¾**ï¼šä½¿ç”¨ `namei -l` æ£€æŸ¥è·¯å¾„æƒé™
4. **æµ‹è¯•æƒé™å˜æ›´**ï¼šæ·»åŠ ç”¨æˆ·åˆ°ç»„åè¦æ±‚é‡æ–°ç™»å½•
5. **ä½¿ç”¨ACLè¡¥å……**ï¼šåœ¨ä¼ ç»Ÿç»„æƒé™ä¸å¤Ÿç”¨æ—¶ä½¿ç”¨ACL

---

## 8. ğŸ”„ æƒé™ç»§æ‰¿é”™è¯¯ä¿®å¤


### 8.1 æƒé™ç»§æ‰¿æœºåˆ¶


**ä»€ä¹ˆæ˜¯æƒé™ç»§æ‰¿**ï¼Ÿ
åœ¨Linuxä¸­ï¼Œæƒé™ç»§æ‰¿ä¸»è¦å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µï¼š
- æ–°å»ºæ–‡ä»¶ç»§æ‰¿çˆ¶ç›®å½•çš„æƒé™ï¼ˆå—umaskå½±å“ï¼‰
- SGIDç›®å½•ä¸­çš„æ–°æ–‡ä»¶ç»§æ‰¿ç›®å½•çš„å±ç»„
- ACLé»˜è®¤æƒé™çš„ç»§æ‰¿

**umaskçš„ä½œç”¨**ï¼š
umaskå†³å®šäº†æ–°å»ºæ–‡ä»¶å’Œç›®å½•çš„é»˜è®¤æƒé™ã€‚å®ƒæ˜¯ä¸€ä¸ª"æƒé™æ©ç "ï¼Œä»æœ€å¤§æƒé™ä¸­å‡å»umaskå€¼å°±æ˜¯å®é™…æƒé™ã€‚

```
æƒé™è®¡ç®—å…¬å¼ï¼š
æ–°æ–‡ä»¶æƒé™ = æœ€å¤§æƒé™(666) - umaskå€¼
æ–°ç›®å½•æƒé™ = æœ€å¤§æƒé™(777) - umaskå€¼

ç¤ºä¾‹ï¼š
umask = 022
æ–°æ–‡ä»¶æƒé™ = 666 - 022 = 644 (rw-r--r--)
æ–°ç›®å½•æƒé™ = 777 - 022 = 755 (rwxr-xr-x)
```

### 8.2 æƒé™ç»§æ‰¿é—®é¢˜è¯Šæ–­


**é—®é¢˜1ï¼šæ–°å»ºæ–‡ä»¶æƒé™ä¸ç¬¦åˆé¢„æœŸ**

```bash
# æ£€æŸ¥å½“å‰umaskè®¾ç½®
$ umask
0022

# æµ‹è¯•æ–‡ä»¶æƒé™ç»§æ‰¿
$ touch testfile
$ ls -l testfile
-rw-r--r-- 1 user user 0 Jan 1 12:00 testfile

# å¦‚æœæƒé™ä¸ç¬¦åˆé¢„æœŸï¼Œæ£€æŸ¥ï¼š
1. umaskè®¾ç½®æ˜¯å¦æ­£ç¡®
2. çˆ¶ç›®å½•æ˜¯å¦æœ‰ç‰¹æ®Šæƒé™ï¼ˆSGIDã€ACLï¼‰
3. æ˜¯å¦æœ‰å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆå¦‚SELinuxï¼‰å½±å“
```

**é—®é¢˜2ï¼šç›®å½•ä¸­æ–‡ä»¶å±ç»„ä¸ä¸€è‡´**

```bash
# åœ¨æ²¡æœ‰è®¾ç½®SGIDçš„ç›®å½•ä¸­
$ mkdir normal_dir
$ ls -ld normal_dir
drwxr-xr-x 2 user user 4096 Jan 1 12:00 normal_dir

$ touch normal_dir/file1
$ ls -l normal_dir/file1
-rw-r--r-- 1 user user 0 Jan 1 12:00 file1    # å±ç»„æ˜¯user

# è®¾ç½®SGIDå
$ chmod g+s normal_dir
$ ls -ld normal_dir  
drwxr-sr-x 2 user user 4096 Jan 1 12:00 normal_dir

$ touch normal_dir/file2
$ ls -l normal_dir/file2
-rw-r--r-- 1 user user 0 Jan 1 12:00 file2    # å±ç»„ç»§æ‰¿ç›®å½•çš„å±ç»„
```

### 8.3 ä¿®å¤æƒé™ç»§æ‰¿é—®é¢˜


**ä¿®å¤æ–¹æ³•1ï¼šè°ƒæ•´umaskè®¾ç½®**

```bash
# ä¸´æ—¶ä¿®æ”¹umaskï¼ˆåªå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆï¼‰
$ umask 002    # è®¾ç½®æ›´å®½æ¾çš„æƒé™

# æ°¸ä¹…ä¿®æ”¹umask
# åœ¨ç”¨æˆ·çš„ ~/.bashrc æˆ– ~/.profile ä¸­æ·»åŠ ï¼š
umask 002

# ç³»ç»Ÿçº§åˆ«ä¿®æ”¹ï¼ˆåœ¨ /etc/profile æˆ– /etc/bash.bashrc ä¸­ï¼‰
```

**ä¿®å¤æ–¹æ³•2ï¼šè®¾ç½®ç›®å½•çš„SGIDæƒé™**

```bash
# ä¸ºå…±äº«ç›®å½•è®¾ç½®SGID
$ mkdir /shared/team_project
$ chown root:team /shared/team_project
$ chmod g+s /shared/team_project
$ chmod 775 /shared/team_project

# éªŒè¯ç»§æ‰¿æ•ˆæœ
$ cd /shared/team_project
$ touch newfile
$ ls -l newfile
-rw-r--r-- 1 user team 0 Jan 1 12:00 newfile    # è‡ªåŠ¨ç»§æ‰¿teamç»„
```

**ä¿®å¤æ–¹æ³•3ï¼šä½¿ç”¨ACLé»˜è®¤æƒé™**

```bash
# è®¾ç½®ç›®å½•çš„é»˜è®¤ACL
$ mkdir /project
$ setfacl -d -m u::rwx,g::rwx,o::r-x /project
$ setfacl -d -m u:developer:rw-,g:testers:r-- /project

# æµ‹è¯•ç»§æ‰¿
$ touch /project/newfile
$ getfacl /project/newfile
# file: project/newfile
# owner: user
# group: user
user::rw-
user:developer:rw-
group::rwx
group:testers:r--
mask::rw-
other::r-x
```

### 8.4 æ‰¹é‡ä¿®å¤æƒé™ç»§æ‰¿é”™è¯¯


**åœºæ™¯ï¼šå¤§é‡æ–‡ä»¶æƒé™ä¸ä¸€è‡´éœ€è¦æ‰¹é‡ä¿®å¤**

```bash
# æ‰¹é‡ä¿®å¤æ–‡ä»¶æƒé™
# å°†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶è®¾ä¸º644ï¼Œç›®å½•è®¾ä¸º755
$ find /path/to/fix -type f -exec chmod 644 {} \;
$ find /path/to/fix -type d -exec chmod 755 {} \;

# æ‰¹é‡ä¿®å¤å±ä¸»å±ç»„
$ chown -R correct_user:correct_group /path/to/fix

# æ‰¹é‡è®¾ç½®ACLæƒé™
$ find /path/to/fix -type f -exec setfacl -m u:alice:rw {} \;
$ find /path/to/fix -type d -exec setfacl -m u:alice:rwx {} \;
```

**åˆ›å»ºæƒé™ä¿®å¤è„šæœ¬**ï¼š

```bash
#!/bin/bash
# fix_permissions.sh - æƒé™ä¿®å¤è„šæœ¬

TARGET_DIR="$1"
if [ -z "$TARGET_DIR" ]; then
    echo "ç”¨æ³•: $0 <ç›®æ ‡ç›®å½•>"
    exit 1
fi

echo "æ­£åœ¨ä¿®å¤ $TARGET_DIR çš„æƒé™..."

# ä¿®å¤ç›®å½•æƒé™
find "$TARGET_DIR" -type d -exec chmod 755 {} \;

# ä¿®å¤æ–‡ä»¶æƒé™  
find "$TARGET_DIR" -type f -exec chmod 644 {} \;

# è®¾ç½®å…±äº«ç›®å½•çš„SGID
if [ -d "$TARGET_DIR/shared" ]; then
    chmod g+s "$TARGET_DIR/shared"
    echo "å·²ä¸ºå…±äº«ç›®å½•è®¾ç½®SGIDæƒé™"
fi

echo "æƒé™ä¿®å¤å®Œæˆï¼"
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„è¯Šæ–­æ–¹æ³•


```
ğŸ”¸ æƒé™è¯Šæ–­ä¸‰æ­¥æ³•ï¼šç¡®è®¤ç”¨æˆ·èº«ä»½ â†’ æ£€æŸ¥æ–‡ä»¶æƒé™ â†’ åˆ†ææƒé™åŒ¹é…
ğŸ”¸ SELinuxé—®é¢˜ï¼šæ£€æŸ¥çŠ¶æ€ â†’ æŸ¥çœ‹ä¸Šä¸‹æ–‡ â†’ åˆ†æå®¡è®¡æ—¥å¿—
ğŸ”¸ å±ä¸»å±ç»„å¼‚å¸¸ï¼šæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ â†’ æŸ¥æ‰¾å­¤å„¿æ–‡ä»¶ â†’ æ‰¹é‡ä¿®å¤
ğŸ”¸ sudoæƒé™é”™è¯¯ï¼šæ£€æŸ¥é…ç½®è¯­æ³• â†’ éªŒè¯ç”¨æˆ·ç»„ â†’ æŸ¥çœ‹æ—¥å¿—
ğŸ”¸ ç‰¹æ®Šæƒé™ä½ï¼šç†è§£SUID/SGID/Sticky â†’ å®šæœŸå®‰å…¨å®¡è®¡ â†’ æ­£ç¡®è®¾ç½®
ğŸ”¸ ACLæƒé™å†²çªï¼šç†è§£ä¼˜å…ˆçº§ â†’ æ£€æŸ¥maskå€¼ â†’ è®¾ç½®é»˜è®¤ACL
ğŸ”¸ ç”¨æˆ·ç»„é—®é¢˜ï¼šç¡®è®¤ç»„æˆå‘˜ â†’ é‡æ–°ç™»å½•ç”Ÿæ•ˆ â†’ ä½¿ç”¨newgrpæµ‹è¯•
ğŸ”¸ æƒé™ç»§æ‰¿ï¼šè°ƒæ•´umask â†’ è®¾ç½®SGID â†’ ä½¿ç”¨ACLé»˜è®¤æƒé™
```

### 9.2 æ•…éšœæ’æŸ¥æ ¸å¿ƒæŠ€å·§


**ğŸ”¹ ç³»ç»Ÿæ€§è¯Šæ–­æµç¨‹**
```
åŸºç¡€æƒé™æ£€æŸ¥ â†’ SELinuxçŠ¶æ€ç¡®è®¤ â†’ ç‰¹æ®Šæƒé™éªŒè¯ â†’ ACLæƒé™åˆ†æ
```

**ğŸ”¹ å¸¸ç”¨è¯Šæ–­å‘½ä»¤é€ŸæŸ¥**
| é—®é¢˜ç±»å‹ | **ä¸»è¦å‘½ä»¤** | **å…³é”®é€‰é¡¹** |
|---------|-------------|-------------|
| åŸºç¡€æƒé™ | `ls -l`, `stat` | `-d`(ç›®å½•), `-Z`(SELinux) |
| SELinux | `getenforce`, `ls -Z` | `restorecon`, `ausearch` |
| å±ä¸»å±ç»„ | `chown`, `find` | `-nouser`, `-nogroup` |
| sudoæƒé™ | `visudo`, `sudo -l` | `-c`(æ£€æŸ¥è¯­æ³•), `-U`(æ£€æŸ¥ç”¨æˆ·) |
| ACLæƒé™ | `getfacl`, `setfacl` | `-R`(é€’å½’), `-d`(é»˜è®¤) |
| ç”¨æˆ·ç»„ | `groups`, `id` | `-Gn`(æ‰€æœ‰ç»„å) |

### 9.3 é¢„é˜²æ€§ç»´æŠ¤å»ºè®®


**ğŸ”§ æ—¥å¸¸ç»´æŠ¤æ£€æŸ¥æ¸…å•**
- [x] å®šæœŸå®¡è®¡SUID/SGIDæ–‡ä»¶
- [x] æ£€æŸ¥å­¤å„¿æ–‡ä»¶ï¼ˆå±ä¸»ä¸å­˜åœ¨ï¼‰
- [x] éªŒè¯å…³é”®ç›®å½•æƒé™è®¾ç½®
- [x] ç›‘æ§sudoæ“ä½œæ—¥å¿—
- [x] å¤‡ä»½æƒé™é…ç½®æ–‡ä»¶

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
- è°¨æ…è®¾ç½®SUID/SGIDæƒé™
- å®šæœŸæ£€æŸ¥sudoersé…ç½®
- ç›‘æ§å¼‚å¸¸æƒé™å˜æ›´
- åŠæ—¶æ¸…ç†æ— æ•ˆç”¨æˆ·è´¦å·
- ä½¿ç”¨æœ€å°æƒé™åŸåˆ™

### 9.4 å®æˆ˜åº”ç”¨ä»·å€¼


- **ç³»ç»Ÿç®¡ç†**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³æƒé™é—®é¢˜
- **å®‰å…¨è¿ç»´**ï¼šè¯†åˆ«æƒé™é…ç½®é£é™©ç‚¹
- **æ•…éšœå¤„ç†**ï¼šç³»ç»Ÿæ€§è§£å†³å¤æ‚æƒé™å†²çª
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šç¼–å†™æƒé™ä¿®å¤è„šæœ¬
- **å›¢é˜Ÿåä½œ**ï¼šè®¾è®¡åˆç†çš„æƒé™åˆ†é…æ–¹æ¡ˆ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> æƒé™é—®é¢˜ä¸å¯æ€•ï¼Œç³»ç»Ÿè¯Šæ–­æœ‰æ–¹æ³•  
> ç”¨æˆ·èº«ä»½å…ˆç¡®è®¤ï¼Œæ–‡ä»¶æƒé™ç»†æ£€æŸ¥  
> SELinuxä¸Šä¸‹æ–‡çœ‹ï¼Œç‰¹æ®Šæƒé™è¦å®¡æŸ¥  
> sudoé…ç½®è¯­æ³•å¯¹ï¼ŒACLå†²çªå·§å¤„ç†  
> ç”¨æˆ·ç»„æƒé™éœ€é‡ç™»ï¼Œç»§æ‰¿æœºåˆ¶umaskæŠ“