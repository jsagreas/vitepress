---
title: 7ã€å‘Šè­¦é€šçŸ¥æ¸ é“é…ç½®
---
## ğŸ“š ç›®å½•

1. [å‘Šè­¦é€šçŸ¥æ¦‚è¿°](#1-å‘Šè­¦é€šçŸ¥æ¦‚è¿°)
2. [é‚®ä»¶é€šçŸ¥é…ç½®](#2-é‚®ä»¶é€šçŸ¥é…ç½®)
3. [å³æ—¶é€šè®¯é›†æˆ](#3-å³æ—¶é€šè®¯é›†æˆ)
4. [webhookè‡ªå®šä¹‰é€šçŸ¥](#4-webhookè‡ªå®šä¹‰é€šçŸ¥)
5. [ä¼ä¸šçº§å‘Šè­¦å¹³å°](#5-ä¼ä¸šçº§å‘Šè­¦å¹³å°)
6. [çŸ­ä¿¡ä¸ç”µè¯å‘Šè­¦](#6-çŸ­ä¿¡ä¸ç”µè¯å‘Šè­¦)
7. [å¤šæ¸ é“é€šçŸ¥ç­–ç•¥](#7-å¤šæ¸ é“é€šçŸ¥ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¢ å‘Šè­¦é€šçŸ¥æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å‘Šè­¦é€šçŸ¥


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> å‘Šè­¦é€šçŸ¥å°±åƒå®¶é‡Œçš„çƒŸé›¾æŠ¥è­¦å™¨ï¼Œå½“ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œè‡ªåŠ¨é€šè¿‡å„ç§æ–¹å¼ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€ç”µè¯ï¼‰é€šçŸ¥è¿ç»´äººå‘˜ï¼Œç¡®ä¿é—®é¢˜èƒ½è¢«åŠæ—¶å‘ç°å’Œå¤„ç†ã€‚

**å‘Šè­¦é€šçŸ¥çš„æœ¬è´¨**ï¼š
```
ç³»ç»Ÿç›‘æ§ â†’ å‘ç°é—®é¢˜ â†’ è§¦å‘å‘Šè­¦ â†’ é€šçŸ¥ç›¸å…³äººå‘˜ â†’ å¿«é€Ÿå“åº”
```

**ä¸ºä»€ä¹ˆéœ€è¦å¤šæ¸ é“é€šçŸ¥ï¼Ÿ**

| åœºæ™¯ | é€šçŸ¥æ–¹å¼ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|----------|------|------|
| ğŸŒ™ **å¤œé—´æ•…éšœ** | ç”µè¯/çŸ­ä¿¡ | èƒ½å¤ŸåŠæ—¶å”¤é†’ | æˆæœ¬è¾ƒé«˜ |
| ğŸ’¼ **å·¥ä½œæ—¶é—´** | é’‰é’‰/å¾®ä¿¡ | å®æ—¶åˆ°è¾¾ | å¯èƒ½è¢«å¿½ç•¥ |
| ğŸ“Š **è¯¦ç»†ä¿¡æ¯** | é‚®ä»¶ | ä¿¡æ¯å®Œæ•´ | å¯èƒ½å»¶è¿Ÿ |
| ğŸš¨ **ç´§æ€¥æƒ…å†µ** | å¤šæ¸ é“åŒæ—¶ | ç¡®ä¿é€è¾¾ | é¿å…å‘Šè­¦ç–²åŠ³ |

### 1.2 Alertmanageré€šçŸ¥æ¶æ„


```
Prometheus        Alertmanager           é€šçŸ¥æ¸ é“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›‘æ§è§„åˆ™   â”‚â”€â”€â–¶â”‚ æ¥æ”¶å‘Šè­¦         â”‚â”€â”€â–¶â”‚ é‚®ä»¶        â”‚
â”‚ è§¦å‘å‘Šè­¦   â”‚   â”‚ â”œâ”€ åˆ†ç»„          â”‚   â”‚ é’‰é’‰/å¾®ä¿¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”œâ”€ æŠ‘åˆ¶          â”‚   â”‚ Slack       â”‚
                 â”‚ â”œâ”€ é™é»˜          â”‚   â”‚ webhook     â”‚
                 â”‚ â””â”€ è·¯ç”±åˆ†å‘      â”‚   â”‚ çŸ­ä¿¡/ç”µè¯   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“§ é‚®ä»¶é€šçŸ¥é…ç½®


### 2.1 SMTPåŸºç¡€é…ç½®


> **ğŸ“Œ å…³é”®æ¦‚å¿µ**
> SMTPå°±åƒä¼ ç»Ÿçš„é‚®å±€ç³»ç»Ÿï¼ŒAlertmanageré€šè¿‡SMTPæœåŠ¡å™¨å‘é€é‚®ä»¶ï¼Œå°±åƒä½ å†™ä¿¡æŠ•é€’åˆ°é‚®å±€ä¸€æ ·ã€‚

**åŸºç¡€SMTPé…ç½®**ï¼š
```yaml
# alertmanager.yml
global:
  # SMTPæœåŠ¡å™¨é…ç½®
  smtp_smarthost: 'smtp.qq.com:587'
  smtp_from: 'monitor@company.com'
  smtp_auth_username: 'monitor@company.com'
  smtp_auth_password: 'your-smtp-password'
  smtp_require_tls: true
```

### 2.2 é‚®ä»¶æ¥æ”¶å™¨é…ç½®


**å•ä¸ªé‚®ç®±é€šçŸ¥**ï¼š
```yaml
route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'email-notifications'

receivers:
- name: 'email-notifications'
  email_configs:
  - to: 'admin@company.com'
    subject: 'ğŸš¨ å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
    html: |
      <h3>å‘Šè­¦è¯¦æƒ…</h3>
      <p><strong>å‘Šè­¦åç§°ï¼š</strong>{{ .GroupLabels.alertname }}</p>
      <p><strong>å‘Šè­¦æ—¶é—´ï¼š</strong>{{ .CommonAnnotations.timestamp }}</p>
      <p><strong>å‘Šè­¦æè¿°ï¼š</strong>{{ .CommonAnnotations.description }}</p>
```

**å¤šäººåˆ†ç»„é€šçŸ¥**ï¼š
```yaml
receivers:
- name: 'database-team'
  email_configs:
  - to: 'dba@company.com,db-ops@company.com'
    subject: 'ğŸ”´ æ•°æ®åº“å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
    
- name: 'application-team'  
  email_configs:
  - to: 'dev@company.com,app-ops@company.com'
    subject: 'ğŸŸ¡ åº”ç”¨å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
```

### 2.3 é‚®ä»¶æ¨¡æ¿ä¼˜åŒ–


> **ğŸ¨ æ¨¡æ¿è®¾è®¡è¦ç‚¹**
> å¥½çš„å‘Šè­¦é‚®ä»¶å°±åƒæ–°é—»æŠ¥é“ï¼šæ ‡é¢˜å¸å¼•æ³¨æ„ï¼Œå†…å®¹ä¸€ç›®äº†ç„¶ï¼Œå…³é”®ä¿¡æ¯çªå‡ºæ˜¾ç¤ºã€‚

**HTMLé‚®ä»¶æ¨¡æ¿**ï¼š
```yaml
receivers:
- name: 'formatted-email'
  email_configs:
  - to: 'ops@company.com'
    subject: '{{ if eq .Status "firing" }}ğŸš¨ FIRING{{ else }}âœ… RESOLVED{{ end }} - {{ .GroupLabels.alertname }}'
    html: |
      <!DOCTYPE html>
      <html>
      <head>
        <style>
          .alert-firing { background-color: #ff4444; color: white; }
          .alert-resolved { background-color: #44ff44; color: white; }
          .info-table { border-collapse: collapse; width: 100%; }
          .info-table th, .info-table td { border: 1px solid #ddd; padding: 8px; }
        </style>
      </head>
      <body>
        <div class="{{ if eq .Status "firing" }}alert-firing{{ else }}alert-resolved{{ end }}">
          <h2>å‘Šè­¦çŠ¶æ€ï¼š{{ .Status | title }}</h2>
        </div>
        
        <table class="info-table">
          <tr><th>å‘Šè­¦åç§°</th><td>{{ .GroupLabels.alertname }}</td></tr>
          <tr><th>å½±å“æœåŠ¡</th><td>{{ .CommonLabels.instance }}</td></tr>
          <tr><th>å‘Šè­¦æ—¶é—´</th><td>{{ .CommonAnnotations.startsAt }}</td></tr>
          <tr><th>é—®é¢˜æè¿°</th><td>{{ .CommonAnnotations.description }}</td></tr>
          <tr><th>å¤„ç†å»ºè®®</th><td>{{ .CommonAnnotations.runbook_url }}</td></tr>
        </table>
        
        <h3>è¯¦ç»†ä¿¡æ¯ï¼š</h3>
        <ul>
        {{ range .Alerts }}
          <li>{{ .Annotations.summary }} ({{ .Labels.instance }})</li>
        {{ end }}
        </ul>
      </body>
      </html>
```

---

## 3. ğŸ’¬ å³æ—¶é€šè®¯é›†æˆ


### 3.1 é’‰é’‰æœºå™¨äººé…ç½®


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> é’‰é’‰æœºå™¨äººå°±åƒç¾¤é‡Œçš„è‡ªåŠ¨åŠ©æ‰‹ï¼Œå½“ç³»ç»Ÿå‡ºé—®é¢˜æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨ç¾¤é‡Œ@ç›¸å…³äººå‘˜ï¼Œæ¯”é‚®ä»¶æ›´å®¹æ˜“è¢«åŠæ—¶çœ‹åˆ°ã€‚

**é’‰é’‰webhooké…ç½®**ï¼š
```yaml
receivers:
- name: 'dingtalk-webhook'
  webhook_configs:
  - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN'
    send_resolved: true
    http_config:
      proxy_url: 'http://proxy.company.com:8080'
    max_alerts: 10
```

**é’‰é’‰æ¶ˆæ¯æ¨¡æ¿**ï¼š
```yaml
# éœ€è¦é…ç½®webhook_configæ¨¡æ¿æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹é€‚é…å™¨
# ç¤ºä¾‹æ¶ˆæ¯æ ¼å¼
{
  "msgtype": "markdown",
  "markdown": {
    "title": "ç³»ç»Ÿå‘Šè­¦é€šçŸ¥",
    "text": "## ğŸš¨ å‘Šè­¦é€šçŸ¥\n\n**å‘Šè­¦åç§°ï¼š**{{ .GroupLabels.alertname }}\n\n**å‘Šè­¦ç­‰çº§ï¼š**{{ .CommonLabels.severity }}\n\n**å½±å“ä¸»æœºï¼š**{{ .CommonLabels.instance }}\n\n**é—®é¢˜æè¿°ï¼š**{{ .CommonAnnotations.description }}\n\n**å‘Šè­¦æ—¶é—´ï¼š**{{ .CommonAnnotations.startsAt }}"
  },
  "at": {
    "atMobiles": ["13800138000"],
    "isAtAll": false
  }
}
```

### 3.2 ä¼ä¸šå¾®ä¿¡é›†æˆ


**ä¼ä¸šå¾®ä¿¡æœºå™¨äººé…ç½®**ï¼š
```yaml
receivers:
- name: 'wechat-work'
  webhook_configs:
  - url: 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY'
    send_resolved: true
    title: '{{ if eq .Status "firing" }}ğŸš¨ ç³»ç»Ÿå‘Šè­¦{{ else }}âœ… å‘Šè­¦æ¢å¤{{ end }}'
    text: |
      **å‘Šè­¦è¯¦æƒ…ï¼š**
      - å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}
      - å‘Šè­¦çŠ¶æ€ï¼š{{ .Status }}
      - å½±å“å®ä¾‹ï¼š{{ .CommonLabels.instance }}
      - é—®é¢˜æè¿°ï¼š{{ .CommonAnnotations.description }}
      - å‘Šè­¦æ—¶é—´ï¼š{{ .CommonAnnotations.startsAt }}
```

### 3.3 Slacké€šçŸ¥é…ç½®


**Slacké…ç½®ç¤ºä¾‹**ï¼š
```yaml
global:
  slack_api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'

receivers:
- name: 'slack-notifications'
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'
    channel: '#ops-alerts'
    username: 'AlertManager'
    icon_emoji: ':warning:'
    title: '{{ if eq .Status "firing" }}ğŸš¨ ALERT FIRING{{ else }}âœ… ALERT RESOLVED{{ end }}'
    text: |
      *Alert:* {{ .GroupLabels.alertname }}
      *Status:* {{ .Status }}
      *Instance:* {{ .CommonLabels.instance }}
      *Description:* {{ .CommonAnnotations.description }}
    fallback: 'Alert: {{ .GroupLabels.alertname }}'
    fields:
    - title: 'Severity'
      value: '{{ .CommonLabels.severity }}'
      short: true
    - title: 'Instance'  
      value: '{{ .CommonLabels.instance }}'
      short: true
```

---

## 4. ğŸ”— webhookè‡ªå®šä¹‰é€šçŸ¥


### 4.1 webhookå·¥ä½œåŸç†


> **ğŸ” æ·±å…¥ç†è§£**
> webhookå°±åƒè®¾ç½®ä¸€ä¸ª"ç”µè¯è½¬æ¥"ï¼Œå½“å‘Šè­¦å‘ç”Ÿæ—¶ï¼ŒAlertmanagerè‡ªåŠ¨æ‹¨æ‰“ä½ æŒ‡å®šçš„"ç”µè¯å·ç "ï¼ˆURLï¼‰ï¼ŒæŠŠå‘Šè­¦ä¿¡æ¯ä¼ é€’ç»™ä½ çš„è‡ªå®šä¹‰ç¨‹åºã€‚

**webhookæ‰§è¡Œæµç¨‹**ï¼š
```
Alertmanager â†’ HTTP POST â†’ ä½ çš„æ¥æ”¶ç«¯ç‚¹ â†’ è‡ªå®šä¹‰å¤„ç†é€»è¾‘
     |              |           |              |
   å‘Šè­¦æ•°æ®    JSONæ ¼å¼    è§£ææ•°æ®      å‘é€é€šçŸ¥
```

### 4.2 webhooké…ç½®


**åŸºç¡€webhooké…ç½®**ï¼š
```yaml
receivers:
- name: 'custom-webhook'
  webhook_configs:
  - url: 'http://your-service.com/webhook/alerts'
    send_resolved: true
    http_config:
      bearer_token: 'your-auth-token'
      tls_config:
        insecure_skip_verify: true
    max_alerts: 20
```

**é«˜çº§webhooké…ç½®**ï¼š
```yaml
receivers:
- name: 'advanced-webhook'
  webhook_configs:
  - url: 'https://api.company.com/alerts/receiver'
    send_resolved: true
    http_config:
      basic_auth:
        username: 'webhook_user'
        password: 'webhook_pass'
      bearer_token_file: '/etc/alertmanager/webhook-token'
      proxy_url: 'http://proxy.company.com:8080'
      tls_config:
        ca_file: '/etc/ssl/certs/ca.pem'
        cert_file: '/etc/ssl/certs/client.pem'
        key_file: '/etc/ssl/private/client.key'
    max_alerts: 100
```

### 4.3 webhookæ•°æ®æ ¼å¼


**æ¥æ”¶çš„JSONæ•°æ®ç»“æ„**ï¼š
```json
{
  "version": "4",
  "groupKey": "{}:{alertname=\"HighErrorRate\"}",
  "status": "firing",
  "receiver": "custom-webhook",
  "groupLabels": {
    "alertname": "HighErrorRate"
  },
  "commonLabels": {
    "alertname": "HighErrorRate",
    "instance": "web-01:8080",
    "job": "web-service",
    "severity": "critical"
  },
  "commonAnnotations": {
    "description": "Error rate is above 5% for 5 minutes",
    "runbook_url": "https://wiki.company.com/runbook/high-error-rate",
    "summary": "High error rate detected"
  },
  "alerts": [
    {
      "status": "firing",
      "labels": {
        "alertname": "HighErrorRate",
        "instance": "web-01:8080"
      },
      "annotations": {
        "description": "Current error rate: 8.5%"
      },
      "startsAt": "2025-09-17T10:15:30.123Z",
      "endsAt": "0001-01-01T00:00:00Z"
    }
  ]
}
```

### 4.4 è‡ªå®šä¹‰webhookå¤„ç†ç¨‹åº


**Python webhookæ¥æ”¶å™¨ç¤ºä¾‹**ï¼š
```python
from flask import Flask, request, jsonify
import requests
import json

app = Flask(__name__)

@app.route('/webhook/alerts', methods=['POST'])
def handle_alerts():
    data = request.get_json()
    
    # è§£æå‘Šè­¦æ•°æ®
    status = data.get('status')
    alerts = data.get('alerts', [])
    
    for alert in alerts:
        alert_name = alert['labels'].get('alertname')
        instance = alert['labels'].get('instance')
        severity = alert['labels'].get('severity', 'unknown')
        description = alert['annotations'].get('description')
        
        # æ ¹æ®ä¸¥é‡ç¨‹åº¦é€‰æ‹©é€šçŸ¥æ–¹å¼
        if severity == 'critical':
            send_sms_alert(alert_name, instance, description)
            send_phone_call(alert_name)
        elif severity == 'warning':
            send_slack_message(alert_name, instance, description)
        
        # è®°å½•å‘Šè­¦æ—¥å¿—
        log_alert(alert)
    
    return jsonify({"status": "received"}), 200

def send_sms_alert(name, instance, desc):
    # å‘é€çŸ­ä¿¡é€»è¾‘
    pass

def send_phone_call(name):
    # ç”µè¯å‘Šè­¦é€»è¾‘
    pass
```

---

## 5. ğŸ¢ ä¼ä¸šçº§å‘Šè­¦å¹³å°


### 5.1 PagerDutyé›†æˆ


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> PagerDutyå°±åƒä¸“ä¸šçš„å€¼ç­è°ƒåº¦ç³»ç»Ÿï¼Œä¸ä»…èƒ½å‘é€å‘Šè­¦ï¼Œè¿˜èƒ½ç®¡ç†å€¼ç­è½®æ¢ã€å‡çº§é€šçŸ¥ã€ç¡®ä¿å‘Šè­¦ä¸€å®šæœ‰äººå¤„ç†ã€‚

**PagerDutyé…ç½®**ï¼š
```yaml
global:
  pagerduty_url: 'https://events.pagerduty.com/v2/enqueue'

receivers:
- name: 'pagerduty-critical'
  pagerduty_configs:
  - service_key: 'YOUR_PAGERDUTY_SERVICE_KEY'
    description: '{{ .GroupLabels.alertname }}: {{ .CommonAnnotations.summary }}'
    details:
      alertname: '{{ .GroupLabels.alertname }}'
      instance: '{{ .CommonLabels.instance }}'
      severity: '{{ .CommonLabels.severity }}'
      description: '{{ .CommonAnnotations.description }}'
      runbook: '{{ .CommonAnnotations.runbook_url }}'
    client: 'Alertmanager'
    client_url: 'https://alertmanager.company.com'
```

**åˆ†çº§å‘Šè­¦é…ç½®**ï¼š
```yaml
route:
  group_by: ['alertname', 'severity']
  routes:
  - match:
      severity: critical
    receiver: 'pagerduty-oncall'
    group_wait: 0s
    group_interval: 5m
    repeat_interval: 15m
    
  - match:
      severity: warning
    receiver: 'slack-team'
    group_wait: 30s
    repeat_interval: 2h
```

### 5.2 OpsGenieé›†æˆ


**OpsGenieé…ç½®ç¤ºä¾‹**ï¼š
```yaml
receivers:
- name: 'opsgenie-alerts'
  opsgenie_configs:
  - api_key: 'YOUR_OPSGENIE_API_KEY'
    api_url: 'https://api.opsgenie.com/v2/alerts'
    message: '{{ .GroupLabels.alertname }}'
    description: '{{ .CommonAnnotations.description }}'
    priority: '{{ if eq .CommonLabels.severity "critical" }}P1{{ else if eq .CommonLabels.severity "warning" }}P3{{ else }}P4{{ end }}'
    tags: 'monitoring,{{ .CommonLabels.service }}'
    teams: '{{ .CommonLabels.team }}'
    actions: 'Acknowledge,Close'
    details:
      Environment: '{{ .CommonLabels.environment }}'
      Service: '{{ .CommonLabels.service }}'
      Instance: '{{ .CommonLabels.instance }}'
```

---

## 6. ğŸ“± çŸ­ä¿¡ä¸ç”µè¯å‘Šè­¦


### 6.1 çŸ­ä¿¡å‘Šè­¦é›†æˆ


> **âš ï¸ æ³¨æ„äº‹é¡¹**
> çŸ­ä¿¡å‘Šè­¦æˆæœ¬è¾ƒé«˜ä¸”æœ‰å‘é€é¢‘ç‡é™åˆ¶ï¼Œé€šå¸¸åªç”¨äºcriticalçº§åˆ«çš„å‘Šè­¦ï¼Œé¿å…çŸ­ä¿¡è½°ç‚¸ã€‚

**é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡é›†æˆ**ï¼š
```python
# webhookå¤„ç†å™¨ä¸­çš„çŸ­ä¿¡å‘é€
from aliyunsdkcore.client import AcsClient
from aliyunsdkdysmsapi.request.v20170525 import SendSmsRequest

def send_sms_alert(phone_number, alert_name, instance):
    client = AcsClient('your-access-key', 'your-access-secret', 'cn-hangzhou')
    
    request = SendSmsRequest.SendSmsRequest()
    request.set_PhoneNumbers(phone_number)
    request.set_SignName('ç›‘æ§å‘Šè­¦')
    request.set_TemplateCode('SMS_TEMPLATE_CODE')
    request.set_TemplateParam({
        "alertname": alert_name,
        "instance": instance,
        "time": datetime.now().strftime('%H:%M')
    })
    
    response = client.do_action_with_exception(request)
    return response
```

**è…¾è®¯äº‘çŸ­ä¿¡é›†æˆ**ï¼š
```yaml
# webhooké…ç½®æŒ‡å‘çŸ­ä¿¡æœåŠ¡
receivers:
- name: 'sms-critical'
  webhook_configs:
  - url: 'http://internal-sms-service/send'
    send_resolved: false  # æ¢å¤æ¶ˆæ¯ä¸å‘çŸ­ä¿¡
    http_config:
      bearer_token: 'sms-service-token'
```

### 5.2 ç”µè¯å‘Šè­¦é…ç½®


**ç”µè¯å‘Šè­¦æœåŠ¡é…ç½®**ï¼š
```yaml
receivers:
- name: 'phone-emergency'
  webhook_configs:
  - url: 'http://voice-alert-service/call'
    send_resolved: false
    http_config:
      timeout: '30s'
      retry_max: 3
    max_alerts: 1  # é™åˆ¶å¹¶å‘ç”µè¯æ•°é‡
```

**è¯­éŸ³å‘Šè­¦å†…å®¹æ¨¡æ¿**ï¼š
```json
{
  "phone_number": "13800138000",
  "message": "ç´§æ€¥å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}ï¼Œå½±å“æœåŠ¡å™¨{{ .CommonLabels.instance }}ï¼Œè¯·ç«‹å³å¤„ç†ã€‚å‘Šè­¦æ—¶é—´{{ .CommonAnnotations.startsAt }}ã€‚"
}
```

---

## 7. ğŸ¯ å¤šæ¸ é“é€šçŸ¥ç­–ç•¥


### 7.1 åˆ†çº§é€šçŸ¥ç­–ç•¥


> **ğŸ§  ç­–ç•¥æ€ç»´**
> å°±åƒç«ç¾æŠ¥è­¦ç³»ç»Ÿï¼šå°çƒŸé›¾åªå“æœ¬åœ°æŠ¥è­¦å™¨ï¼ˆSlackï¼‰ï¼Œå¤§ç«ç¾è¦æ‹‰å“æ•´æ¥¼è­¦æŠ¥ï¼ˆçŸ­ä¿¡+ç”µè¯ï¼‰ï¼Œç¡®ä¿å“åº”åŠæ—¶ä¸”ä¸è¿‡åº¦æ‰“æ‰°ã€‚

**å‘Šè­¦ç­‰çº§ä¸é€šçŸ¥æ¸ é“å¯¹åº”**ï¼š

```
å‘Šè­¦ä¸¥é‡ç¨‹åº¦        é€šçŸ¥æ¸ é“ç»„åˆ               å“åº”æ—¶é—´è¦æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Critical    â”‚â”€â”€â–¶â”‚ ç”µè¯+çŸ­ä¿¡+å³æ—¶é€šè®¯  â”‚â”€â”€â–¶â”‚ 5åˆ†é’Ÿå†…å“åº”  â”‚
â”‚ Warning     â”‚â”€â”€â–¶â”‚ å³æ—¶é€šè®¯+é‚®ä»¶      â”‚â”€â”€â–¶â”‚ 30åˆ†é’Ÿå†…å“åº” â”‚
â”‚ Info        â”‚â”€â”€â–¶â”‚ é‚®ä»¶              â”‚â”€â”€â–¶â”‚ å·¥ä½œæ—¶é—´å¤„ç† â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†çº§è·¯ç”±é…ç½®**ï¼š
```yaml
route:
  group_by: ['alertname', 'severity']
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 12h
  receiver: 'default-receiver'
  
  routes:
  # Criticalå‘Šè­¦ï¼šå¤šæ¸ é“ç«‹å³é€šçŸ¥
  - match:
      severity: critical
    receiver: 'critical-emergency'
    group_wait: 0s
    group_interval: 2m
    repeat_interval: 15m
    
  # Warningå‘Šè­¦ï¼šå·¥ä½œæ—¶é—´å³æ—¶é€šè®¯ï¼Œéå·¥ä½œæ—¶é—´é‚®ä»¶
  - match:
      severity: warning
    receiver: 'warning-business-hours'
    group_wait: 30s
    group_interval: 10m
    repeat_interval: 2h
    
  # Infoå‘Šè­¦ï¼šä»…é‚®ä»¶é€šçŸ¥
  - match:
      severity: info
    receiver: 'info-email-only'
    group_wait: 5m
    group_interval: 30m
    repeat_interval: 24h

receivers:
- name: 'critical-emergency'
  email_configs:
  - to: 'oncall@company.com'
    subject: 'ğŸš¨ CRITICAL: {{ .GroupLabels.alertname }}'
  slack_configs:
  - channel: '#incidents'
    title: 'ğŸš¨ CRITICAL ALERT'
  webhook_configs:
  - url: 'http://sms-service/critical'
  - url: 'http://phone-service/emergency'
```

### 7.2 æ—¶é—´çª—å£é€šçŸ¥ç­–ç•¥


**å·¥ä½œæ—¶é—´ä¸éå·¥ä½œæ—¶é—´å·®å¼‚åŒ–é€šçŸ¥**ï¼š
```yaml
# ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨å®ç°æ—¶é—´å·®å¼‚åŒ–
route:
  routes:
  # å·¥ä½œæ—¶é—´è·¯ç”±
  - match_re:
      time_range: 'business_hours'
    receiver: 'business-hours-team'
    
  # éå·¥ä½œæ—¶é—´è·¯ç”±  
  - match_re:
      time_range: 'after_hours'
    receiver: 'oncall-emergency'

receivers:
- name: 'business-hours-team'
  slack_configs:
  - channel: '#ops-team'
  email_configs:
  - to: 'team@company.com'
    
- name: 'oncall-emergency'
  webhook_configs:
  - url: 'http://pager-service/oncall'
  - url: 'http://sms-service/urgent'
```

### 7.3 å‘Šè­¦æŠ‘åˆ¶ä¸é™é»˜


> **ğŸ“Œ å…³é”®æ¦‚å¿µ**
> å‘Šè­¦æŠ‘åˆ¶å°±åƒå¤šç±³è¯ºéª¨ç‰Œæ•ˆåº”çš„æ§åˆ¶ï¼šå½“æ ¹æœ¬é—®é¢˜ï¼ˆå¦‚ç½‘ç»œä¸­æ–­ï¼‰å‘ç”Ÿæ—¶ï¼Œè‡ªåŠ¨å±è”½ç”±æ­¤å¼•å‘çš„æ¬¡çº§å‘Šè­¦ï¼ˆå¦‚å„æœåŠ¡ä¸å¯è¾¾ï¼‰ï¼Œé¿å…å‘Šè­¦é£æš´ã€‚

**æŠ‘åˆ¶è§„åˆ™é…ç½®**ï¼š
```yaml
inhibit_rules:
# ä¸»æœºå®•æœºæ—¶ï¼ŒæŠ‘åˆ¶è¯¥ä¸»æœºä¸Šçš„æ‰€æœ‰å…¶ä»–å‘Šè­¦
- source_match:
    alertname: 'InstanceDown'
  target_match_re:
    instance: '.*'
  equal: ['instance']
  
# ç½‘ç»œæ•…éšœæ—¶ï¼ŒæŠ‘åˆ¶ç½‘ç»œç›¸å…³çš„æ‰€æœ‰å‘Šè­¦
- source_match:
    alertname: 'NetworkUnreachable'
  target_match_re:
    alertname: '.*Connection.*|.*Timeout.*'
  equal: ['datacenter']
  
# æ•°æ®åº“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼ŒæŠ‘åˆ¶ä»èŠ‚ç‚¹ç›¸å…³å‘Šè­¦
- source_match:
    alertname: 'DatabaseMasterDown'
    service: 'mysql'
  target_match:
    service: 'mysql'
    role: 'slave'
  equal: ['cluster']
```

**é™é»˜ç®¡ç†**ï¼š
```bash
# é€šè¿‡APIåˆ›å»ºé™é»˜
curl -XPOST http://alertmanager:9093/api/v1/silences \
  -H "Content-Type: application/json" \
  -d '{
    "matchers": [
      {
        "name": "alertname",
        "value": "HighMemoryUsage",
        "isRegex": false
      },
      {
        "name": "instance", 
        "value": "web-01:8080",
        "isRegex": false
      }
    ],
    "startsAt": "2025-09-17T15:30:00.000Z",
    "endsAt": "2025-09-17T17:30:00.000Z",
    "createdBy": "admin@company.com",
    "comment": "Planned maintenance window"
  }'
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```yaml
ğŸ”¸ é€šçŸ¥æ¸ é“é€‰æ‹©ï¼šæ ¹æ®å‘Šè­¦ä¸¥é‡ç¨‹åº¦é€‰æ‹©åˆé€‚çš„é€šçŸ¥æ–¹å¼
ğŸ”¸ é‚®ä»¶é…ç½®ï¼šSMTPè®¾ç½®å’ŒHTMLæ¨¡æ¿ç¾åŒ–
ğŸ”¸ å³æ—¶é€šè®¯é›†æˆï¼šé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€Slackç­‰é…ç½®æ–¹æ³•
ğŸ”¸ webhookè‡ªå®šä¹‰ï¼šçµæ´»çš„è‡ªå®šä¹‰é€šçŸ¥å¤„ç†é€»è¾‘
ğŸ”¸ åˆ†çº§é€šçŸ¥ç­–ç•¥ï¼šCritical/Warning/Infoå¯¹åº”ä¸åŒé€šçŸ¥æ¸ é“
ğŸ”¸ å‘Šè­¦æŠ‘åˆ¶ï¼šé¿å…å‘Šè­¦é£æš´çš„é‡è¦æœºåˆ¶
ğŸ”¸ é™é»˜ç®¡ç†ï¼šç»´æŠ¤çª—å£æœŸçš„å‘Šè­¦å±è”½
```

### 8.2 å®é™…åº”ç”¨æœ€ä½³å®è·µ


> **ğŸ’ª å®è·µå»ºè®®**
> - å‘Šè­¦é€šçŸ¥è¦æœ‰å±‚æ¬¡ï¼šä¸æ˜¯æ‰€æœ‰å‘Šè­¦éƒ½éœ€è¦ç”µè¯è½°ç‚¸
> - æ¨¡æ¿è¦æ¸…æ™°ï¼šè®©äººä¸€çœ¼çœ‹å‡ºé—®é¢˜çš„ä¸¥é‡ç¨‹åº¦å’Œå¤„ç†æ–¹æ³•
> - æµ‹è¯•è¦å……åˆ†ï¼šå®šæœŸæµ‹è¯•å„é€šçŸ¥æ¸ é“æ˜¯å¦æ­£å¸¸å·¥ä½œ

**ğŸ”§ é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
- [ ] SMTPæœåŠ¡å™¨è¿æ¥æ­£å¸¸
- [ ] å„å³æ—¶é€šè®¯webhookåœ°å€æœ‰æ•ˆ
- [ ] çŸ­ä¿¡/ç”µè¯æœåŠ¡APIå¯†é’¥é…ç½®æ­£ç¡®
- [ ] å‘Šè­¦æ¨¡æ¿ä¿¡æ¯å®Œæ•´æ˜“è¯»
- [ ] åˆ†çº§é€šçŸ¥ç­–ç•¥åˆç†
- [ ] æŠ‘åˆ¶è§„åˆ™é¿å…å‘Šè­¦é£æš´
- [ ] å®šæœŸæµ‹è¯•é€šçŸ¥æ¸ é“å¯ç”¨æ€§

**âš¡ å…³é”®é…ç½®è¦ç‚¹**ï¼š
```
é€šçŸ¥åŠæ—¶æ€§ > é€šçŸ¥é¢‘ç‡ > é€šçŸ¥ç¾è§‚åº¦
å‡†ç¡®æ€§ > å®Œæ•´æ€§ > ç®€æ´æ€§  
å¯æ“ä½œæ€§ > ä¿¡æ¯é‡ > æ ¼å¼è§„èŒƒ
```

**ğŸ¯ å­¦ä¹ è·¯çº¿å»ºè®®**ï¼š
```
é‚®ä»¶é€šçŸ¥(åŸºç¡€) â†’ å³æ—¶é€šè®¯é›†æˆ(å®ç”¨) â†’ webhookè‡ªå®šä¹‰(é«˜çº§) â†’ ä¼ä¸šå¹³å°é›†æˆ(ä¸“ä¸š)
```

### 8.3 å¸¸è§é—®é¢˜ä¸è§£å†³


| é—®é¢˜ç±»å‹ | å¸¸è§ç°è±¡ | è§£å†³æ–¹æ¡ˆ |
|---------|----------|----------|
| **é€šçŸ¥å»¶è¿Ÿ** | å‘Šè­¦å‘ç”Ÿåå¾ˆä¹…æ‰æ”¶åˆ°é€šçŸ¥ | æ£€æŸ¥ç½‘ç»œè¿æ¥ã€SMTPé…ç½® |
| **é€šçŸ¥é£æš´** | å¤§é‡é‡å¤å‘Šè­¦ | é…ç½®æŠ‘åˆ¶è§„åˆ™ã€è°ƒæ•´group_interval |
| **é€šçŸ¥ç¼ºå¤±** | åº”è¯¥æ”¶åˆ°ä½†æ²¡æœ‰æ”¶åˆ°å‘Šè­¦ | æ£€æŸ¥è·¯ç”±è§„åˆ™ã€æ¥æ”¶å™¨é…ç½® |
| **æ ¼å¼é”™è¯¯** | é€šçŸ¥å†…å®¹ä¹±ç æˆ–æ ¼å¼ä¸å¯¹ | æ£€æŸ¥æ¨¡æ¿è¯­æ³•ã€å­—ç¬¦ç¼–ç  |

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åˆ†çº§é€šçŸ¥é¿é£æš´ï¼Œå…³é”®å‘Šè­¦è¦åŠæ—¶
- æ¨¡æ¿æ¸…æ™°ä¿¡æ¯å…¨ï¼Œwebhookæ‰©å±•æ›´çµæ´»  
- æŠ‘åˆ¶é™é»˜æ§å™ªéŸ³ï¼Œæµ‹è¯•éªŒè¯ä¿å¯ç”¨
- é‚®ä»¶å³æ—¶åŠ çŸ­ä¿¡ï¼Œå¤šæ¸ é“ä¿éšœå“åº”å¿«