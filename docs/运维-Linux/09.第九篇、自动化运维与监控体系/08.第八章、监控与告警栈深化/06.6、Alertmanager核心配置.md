---
title: 6ã€Alertmanageræ ¸å¿ƒé…ç½®
---
## ğŸ“š ç›®å½•


1. [Alertmanageré…ç½®æ–‡ä»¶æ¦‚è¿°](#1-alertmanageré…ç½®æ–‡ä»¶æ¦‚è¿°)
2. [è·¯ç”±è§„åˆ™ä¸åŒ¹é…é€»è¾‘](#2-è·¯ç”±è§„åˆ™ä¸åŒ¹é…é€»è¾‘)
3. [æ¥æ”¶å™¨é…ç½®ä¸é€šçŸ¥æ–¹å¼](#3-æ¥æ”¶å™¨é…ç½®ä¸é€šçŸ¥æ–¹å¼)
4. [å‘Šè­¦åˆ†ç»„ä¸å»é‡æœºåˆ¶](#4-å‘Šè­¦åˆ†ç»„ä¸å»é‡æœºåˆ¶)
5. [å‘Šè­¦æŠ‘åˆ¶ä¸é™é»˜é…ç½®](#5-å‘Šè­¦æŠ‘åˆ¶ä¸é™é»˜é…ç½®)
6. [é€šçŸ¥æ¨¡æ¿å®šåˆ¶](#6-é€šçŸ¥æ¨¡æ¿å®šåˆ¶)
7. [é«˜å¯ç”¨é›†ç¾¤é…ç½®](#7-é«˜å¯ç”¨é›†ç¾¤é…ç½®)
8. [Web UIç®¡ç†ç•Œé¢](#8-web-uiç®¡ç†ç•Œé¢)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# 1. ğŸ“‹ Alertmanageré…ç½®æ–‡ä»¶æ¦‚è¿°



## 1.1 ä»€ä¹ˆæ˜¯alertmanager.yml



**ç®€å•ç†è§£**ï¼š`alertmanager.yml` å°±æ˜¯Alertmanagerçš„é…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼äºå‘Šè­¦å¤„ç†çš„"è§„åˆ™æ‰‹å†Œ"ã€‚

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒé‚®å±€çš„åˆ†æ‹£è§„åˆ™ä¸€æ ·ï¼Œå‘Šè¯‰é‚®ä»¶åº”è¯¥å‘ç»™è°ã€ç”¨ä»€ä¹ˆæ–¹å¼å‘ã€ä»€ä¹ˆæ—¶å€™å‘ã€‚

## 1.2 é…ç½®æ–‡ä»¶åŸºæœ¬ç»“æ„



```yaml
# å…¨å±€é…ç½® - æ‰€æœ‰å‘Šè­¦çš„é€šç”¨è®¾ç½®

global:
#  # é‚®ä»¶æœåŠ¡å™¨é…ç½®
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alert@example.com'
  
# è·¯ç”±è§„åˆ™ - å‘Šè­¦å¦‚ä½•åˆ†å‘

route:
#  # æ ¹è·¯ç”±é…ç½®
  
# æ¥æ”¶å™¨ - å‘Šè­¦å‘é€ç›®æ ‡

receivers:
  - name: 'web-team'
#    # å…·ä½“é€šçŸ¥é…ç½®
    
# æŠ‘åˆ¶è§„åˆ™ - é¿å…é‡å¤å‘Šè­¦  

inhibit_rules:
  - source_match:
#      # æŠ‘åˆ¶è§„åˆ™é…ç½®
```

**ğŸ”¸ é…ç½®ç»“æ„è¯´æ˜**ï¼š
- **global**ï¼šå…¨å±€è®¾ç½®ï¼Œå½±å“æ‰€æœ‰å‘Šè­¦
- **route**ï¼šè·¯ç”±è§„åˆ™ï¼Œå†³å®šå‘Šè­¦å‘ç»™è°  
- **receivers**ï¼šæ¥æ”¶å™¨ï¼Œå®šä¹‰å…·ä½“æ€ä¹ˆå‘
- **inhibit_rules**ï¼šæŠ‘åˆ¶è§„åˆ™ï¼Œé¿å…å‘Šè­¦è½°ç‚¸

## 1.3 é…ç½®æ–‡ä»¶ä½ç½®ä¸åŠ è½½



**é»˜è®¤é…ç½®è·¯å¾„**ï¼š
```bash
/etc/alertmanager/alertmanager.yml
```

**å¯åŠ¨æ—¶æŒ‡å®šé…ç½®**ï¼š
```bash
./alertmanager --config.file=/path/to/alertmanager.yml
```

> âš ï¸ **æ³¨æ„**ï¼šé…ç½®æ–‡ä»¶ä¿®æ”¹åéœ€è¦é‡å¯Alertmanageræˆ–å‘é€SIGHUPä¿¡å·é‡æ–°åŠ è½½

---

# 2. ğŸ›¤ï¸ è·¯ç”±è§„åˆ™ä¸åŒ¹é…é€»è¾‘



## 2.1 è·¯ç”±çš„ä½œç”¨



**é€šä¿—è§£é‡Š**ï¼šè·¯ç”±å°±åƒå¿«é€’åˆ†æ‹£ï¼Œæ ¹æ®å‘Šè­¦çš„"åœ°å€æ ‡ç­¾"å†³å®šå‘ç»™å“ªä¸ªå›¢é˜Ÿã€‚

```
å‘Šè­¦æµç¨‹ï¼š
Prometheus â†’ Alertmanager â†’ è·¯ç”±åŒ¹é… â†’ å¯¹åº”æ¥æ”¶å™¨ â†’ å‘é€é€šçŸ¥
```

## 2.2 è·¯ç”±é…ç½®ç»“æ„



```yaml
route:
#  # é»˜è®¤æ¥æ”¶å™¨ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰
  receiver: 'default-team'
  
#  # åˆ†ç»„æ–¹å¼
  group_by: ['alertname', 'cluster']
  
#  # æ—¶é—´é…ç½®
  group_wait: 10s        # ç­‰å¾…æ”¶é›†åŒç»„å‘Šè­¦çš„æ—¶é—´
  group_interval: 10s    # åŒç»„å‘Šè­¦é‡æ–°å‘é€é—´éš”
  repeat_interval: 1h    # é‡å¤å‘é€é—´éš”
  
#  # å­è·¯ç”±
  routes:
    - match:
        service: mysql
      receiver: 'db-team'
      
    - match:
        severity: critical
      receiver: 'on-call-team'
```

**ğŸ”¸ è·¯ç”±å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | å«ä¹‰ | ä½œç”¨ |
|------|------|------|
| `receiver` | é»˜è®¤æ¥æ”¶å™¨ | æ²¡æœ‰åŒ¹é…åˆ°å­è·¯ç”±æ—¶çš„å…œåº• |
| `group_by` | åˆ†ç»„å­—æ®µ | ç›¸åŒå­—æ®µå€¼çš„å‘Šè­¦ä¼šåˆå¹¶ |
| `group_wait` | åˆ†ç»„ç­‰å¾…æ—¶é—´ | æ”¶é›†åŒç»„å‘Šè­¦é¿å…é¢‘ç¹å‘é€ |
| `group_interval` | åˆ†ç»„å‘é€é—´éš” | åŒç»„æ–°å‘Šè­¦çš„å‘é€é—´éš” |
| `repeat_interval` | é‡å¤é—´éš” | æŒç»­å‘Šè­¦çš„é‡å¤å‘é€æ—¶é—´ |

## 2.3 åŒ¹é…é€»è¾‘è¯¦è§£



**ğŸ¯ åŒ¹é…æ–¹å¼**ï¼š

**å®Œå…¨åŒ¹é…**ï¼š
```yaml
routes:
  - match:
      alertname: HighCPU
      severity: critical
    receiver: 'urgent-team'
```

**æ­£åˆ™åŒ¹é…**ï¼š
```yaml
routes:
  - match_re:
      service: '^(mysql|postgres).*'
    receiver: 'db-team'
```

**åŒ¹é…ä¼˜å…ˆçº§**ï¼š
- â­ ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡åŒ¹é…
- â­ åŒ¹é…æˆåŠŸç«‹å³åœæ­¢ï¼ˆé™¤éè®¾ç½®continue: trueï¼‰
- â­ æœªåŒ¹é…ä»»ä½•å­è·¯ç”±åˆ™ä½¿ç”¨é»˜è®¤receiver

## 2.4 å®ç”¨è·¯ç”±é…ç½®ç¤ºä¾‹



```yaml
route:
  receiver: 'default'
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  
  routes:
#    # ä¸¥é‡å‘Šè­¦ç«‹å³é€šçŸ¥
    - match:
        severity: critical
      receiver: 'pager-duty'
      group_wait: 0s
      repeat_interval: 5m
      
#    # æ•°æ®åº“å‘Šè­¦
    - match_re:
        service: '(mysql|redis|mongodb)'
      receiver: 'db-team'
      
#    # å¼€å‘ç¯å¢ƒå‘Šè­¦é™çº§
    - match:
        env: dev
      receiver: 'dev-slack'
      group_interval: 30m
      repeat_interval: 24h
```

---

# 3. ğŸ“¬ æ¥æ”¶å™¨é…ç½®ä¸é€šçŸ¥æ–¹å¼



## 3.1 æ¥æ”¶å™¨çš„æ¦‚å¿µ



**ç®€å•ç†è§£**ï¼šæ¥æ”¶å™¨å°±æ˜¯å‘Šè­¦çš„"æ”¶ä»¶äºº"ï¼Œå®šä¹‰äº†å‘Šè­¦å‘é€çš„å…·ä½“æ–¹å¼å’Œç›®æ ‡ã€‚

> ğŸ§  **è®°å¿†æŠ€å·§**ï¼šReceiver = æ¥æ”¶è€…ï¼Œå°±æ˜¯å‘Šè­¦çš„æœ€ç»ˆæ”¶ä»¶äºº

## 3.2 å¸¸ç”¨é€šçŸ¥æ–¹å¼



### ğŸ“§ é‚®ä»¶é€šçŸ¥



```yaml
receivers:
  - name: 'email-team'
    email_configs:
      - to: 'devops@company.com'
        from: 'alert@company.com'
        subject: '[å‘Šè­¦] {{ .GroupLabels.alertname }}'
        body: |
          å‘Šè­¦è¯¦æƒ…:
          {{ range .Alerts }}
          - å‘Šè­¦: {{ .Annotations.summary }}
          - æ—¶é—´: {{ .StartsAt }}
          {{ end }}
```

### ğŸ’¬ Slacké€šçŸ¥



```yaml
receivers:
  - name: 'slack-team'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/xxx'
        channel: '#alerts'
        title: '{{ .GroupLabels.alertname }}'
        text: |
          {{ range .Alerts }}
          å‘Šè­¦: {{ .Annotations.summary }}
          è¯¦æƒ…: {{ .Annotations.description }}
          {{ end }}
```

### ğŸ“± é’‰é’‰é€šçŸ¥



```yaml
receivers:
  - name: 'dingtalk-team'
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=xxx'
        send_resolved: true
        http_config:
          proxy_url: 'http://proxy:8080'
```

## 3.3 é€šçŸ¥æ–¹å¼å¯¹æ¯”



| é€šçŸ¥æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| ğŸ“§ **é‚®ä»¶** | `è¯¦ç»†ä¿¡æ¯ï¼Œæ˜“ä¿å­˜` | `ä¸å¤ŸåŠæ—¶` | `è¯¦ç»†æŠ¥å‘Šï¼Œè®°å½•å­˜æ¡£` |
| ğŸ’¬ **Slack/ä¼å¾®** | `å®æ—¶æ€§å¥½ï¼Œå›¢é˜Ÿåä½œ` | `éœ€è¦Appæ”¯æŒ` | `å›¢é˜Ÿæ—¥å¸¸å‘Šè­¦` |
| ğŸ“± **çŸ­ä¿¡/ç”µè¯** | `æœ€åŠæ—¶ï¼Œéšæ—¶å¯è¾¾` | `æˆæœ¬é«˜ï¼Œä¿¡æ¯æœ‰é™` | `ä¸¥é‡å‘Šè­¦ï¼Œç´§æ€¥é€šçŸ¥` |
| ğŸŒ **Webhook** | `é«˜åº¦è‡ªå®šä¹‰` | `éœ€è¦å¼€å‘å¯¹æ¥` | `é›†æˆç¬¬ä¸‰æ–¹ç³»ç»Ÿ` |

---

# 4. ğŸ—‚ï¸ å‘Šè­¦åˆ†ç»„ä¸å»é‡æœºåˆ¶



## 4.1 å‘Šè­¦åˆ†ç»„çš„ä½œç”¨



**é—®é¢˜åœºæ™¯**ï¼šå‡è®¾æœ‰100å°æœåŠ¡å™¨åŒæ—¶CPUè¿‡é«˜ï¼Œå¦‚æœæ¯å°éƒ½å•ç‹¬å‘å‘Šè­¦ï¼Œè¿ç»´äººå‘˜ä¼šè¢«è½°ç‚¸ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šå‘Šè­¦åˆ†ç»„ï¼ŒæŠŠç›¸åŒç±»å‹çš„å‘Šè­¦åˆå¹¶æˆä¸€æ¡é€šçŸ¥ã€‚

```
åˆ†ç»„å‰ï¼š
- æœåŠ¡å™¨A CPUè¿‡é«˜
- æœåŠ¡å™¨B CPUè¿‡é«˜  
- æœåŠ¡å™¨C CPUè¿‡é«˜
... (100æ¡å‘Šè­¦)

åˆ†ç»„åï¼š
- [CPUå‘Šè­¦] 100å°æœåŠ¡å™¨CPUè¿‡é«˜ï¼Œè¯¦è§å‘Šè­¦åˆ—è¡¨
```

## 4.2 åˆ†ç»„é…ç½®è¯¦è§£



```yaml
route:
#  # æŒ‰å‘Šè­¦åç§°å’Œé›†ç¾¤åˆ†ç»„
  group_by: ['alertname', 'cluster']
  
#  # åˆ†ç»„æ—¶é—´é…ç½®
  group_wait: 30s      # æ”¶é›†åŒç»„å‘Šè­¦30ç§’
  group_interval: 5m   # åŒç»„æ–°å‘Šè­¦5åˆ†é’Ÿåå‘é€
  repeat_interval: 4h  # æŒç»­å‘Šè­¦4å°æ—¶é‡å‘
```

**ğŸ”¸ æ—¶é—´å‚æ•°è¯´æ˜**ï¼š

```
æ—¶é—´è½´ç¤ºä¾‹ï¼š
T0: ç¬¬ä¸€ä¸ªå‘Šè­¦è§¦å‘
T0+30s: group_waitæ—¶é—´åˆ°ï¼Œå‘é€ç¬¬ä¸€æ‰¹å‘Šè­¦
T0+5m30s: åŒç»„æ–°å‘Šè­¦ï¼Œç­‰å¾…group_intervalåå‘é€
T0+4h30s: repeat_intervalæ—¶é—´åˆ°ï¼Œé‡å‘å‘Šè­¦
```

## 4.3 åˆ†ç»„ç­–ç•¥æœ€ä½³å®è·µ



**â­ æ¨èåˆ†ç»„æ–¹å¼**ï¼š

```yaml
# åŸºç¡€åˆ†ç»„

group_by: ['alertname']

# ç»†ç²’åº¦åˆ†ç»„

group_by: ['alertname', 'cluster', 'service']

# æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç»„

group_by: ['severity', 'team']
```

**ğŸ’¡ åˆ†ç»„åŸåˆ™**ï¼š
- **ç›¸å…³æ€§**ï¼šç›¸å…³çš„å‘Šè­¦æ”¾ä¸€ç»„
- **å¤„ç†æ–¹å¼ç›¸åŒ**ï¼šéœ€è¦åŒä¸€ä¸ªå›¢é˜Ÿå¤„ç†çš„æ”¾ä¸€ç»„
- **é¿å…è¿‡åº¦åˆ†ç»„**ï¼šåˆ†ç»„å¤ªç»†ä¼šå¤±å»åˆå¹¶æ•ˆæœ

## 4.4 å»é‡æœºåˆ¶



**å»é‡åŸç†**ï¼šç›¸åŒçš„å‘Šè­¦ï¼ˆæ ‡ç­¾å®Œå…¨ç›¸åŒï¼‰åœ¨`repeat_interval`æ—¶é—´å†…åªå‘é€ä¸€æ¬¡ã€‚

```yaml
# å»é‡é…ç½®ç¤ºä¾‹

route:
  repeat_interval: 2h  # 2å°æ—¶å†…ç›¸åŒå‘Šè­¦ä¸é‡å¤å‘é€
```

> âš ï¸ **æ³¨æ„**ï¼šå»é‡åŸºäºå‘Šè­¦çš„æ ‡ç­¾ï¼Œæ ‡ç­¾ä¸åŒä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒå‘Šè­¦ã€‚

---

# 5. ğŸ”‡ å‘Šè­¦æŠ‘åˆ¶ä¸é™é»˜é…ç½®



## 5.1 å‘Šè­¦æŠ‘åˆ¶æœºåˆ¶



**åº”ç”¨åœºæ™¯**ï¼šå½“ç½‘ç»œè®¾å¤‡æ•…éšœæ—¶ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡æœåŠ¡ä¸å¯è¾¾å‘Šè­¦ã€‚è¿™æ—¶åº”è¯¥æŠ‘åˆ¶æœåŠ¡å‘Šè­¦ï¼Œåªä¿ç•™ç½‘ç»œè®¾å¤‡å‘Šè­¦ã€‚

```
æŠ‘åˆ¶é€»è¾‘ï¼š
ç½‘ç»œæ•…éšœ â†’ æŠ‘åˆ¶ â†’ æœåŠ¡ä¸å¯è¾¾å‘Šè­¦
(ä¿ç•™æ ¹å› å‘Šè­¦ï¼ŒæŠ‘åˆ¶è¡ç”Ÿå‘Šè­¦)
```

## 5.2 æŠ‘åˆ¶è§„åˆ™é…ç½®



```yaml
inhibit_rules:
#  # ç½‘ç»œæ•…éšœæŠ‘åˆ¶æœåŠ¡å‘Šè­¦
  - source_match:
      alertname: NetworkDown
    target_match:
      alertname: ServiceUnavailable
    equal: ['cluster']
    
#  # ä¸¥é‡å‘Šè­¦æŠ‘åˆ¶è­¦å‘Šå‘Šè­¦  
  - source_match:
      severity: critical
    target_match:
      severity: warning
    equal: ['service']
```

**ğŸ”¸ æŠ‘åˆ¶è§„åˆ™å‚æ•°**ï¼š

| å‚æ•° | å«ä¹‰ | ä½œç”¨ |
|------|------|------|
| `source_match` | æºå‘Šè­¦åŒ¹é…æ¡ä»¶ | ä»€ä¹ˆå‘Šè­¦ä¼šæŠ‘åˆ¶å…¶ä»–å‘Šè­¦ |
| `target_match` | ç›®æ ‡å‘Šè­¦åŒ¹é…æ¡ä»¶ | è¢«æŠ‘åˆ¶çš„å‘Šè­¦ |
| `equal` | ç›¸ç­‰å­—æ®µ | åªæœ‰è¿™äº›å­—æ®µç›¸åŒæ‰ä¼šæŠ‘åˆ¶ |

## 5.3 é™é»˜é…ç½®



**é™é»˜çš„ä½œç”¨**ï¼šä¸»åŠ¨å±è”½æŸäº›å‘Šè­¦ï¼Œæ¯”å¦‚ç»´æŠ¤æœŸé—´ä¸æƒ³æ”¶åˆ°å‘Šè­¦ã€‚

**å‘½ä»¤è¡Œé™é»˜**ï¼š
```bash
# é™é»˜ç‰¹å®šå‘Šè­¦30åˆ†é’Ÿ

amtool silence add alertname=HighCPU --duration=30m

# æŸ¥çœ‹å½“å‰é™é»˜

amtool silence query

# åˆ é™¤é™é»˜

amtool silence expire <silence-id>
```

**APIé™é»˜**ï¼š
```bash
curl -X POST http://localhost:9093/api/v1/silences \
  -H "Content-Type: application/json" \
  -d '{
    "matchers": [
      {
        "name": "alertname",
        "value": "HighCPU",
        "isRegex": false
      }
    ],
    "startsAt": "2023-10-01T10:00:00Z",
    "endsAt": "2023-10-01T12:00:00Z",
    "comment": "ç»´æŠ¤æœŸé—´é™é»˜"
  }'
```

---

# 6. ğŸ¨ é€šçŸ¥æ¨¡æ¿å®šåˆ¶



## 6.1 æ¨¡æ¿çš„ä½œç”¨



**é»˜è®¤é€šçŸ¥å†…å®¹**ï¼šé€šå¸¸æ¯”è¾ƒç®€å•ï¼Œä¿¡æ¯ä¸å¤Ÿä¸°å¯Œ
**è‡ªå®šä¹‰æ¨¡æ¿**ï¼šå¯ä»¥åŒ…å«æ›´å¤šæœ‰ç”¨ä¿¡æ¯ï¼Œæ ¼å¼æ›´ç¾è§‚

## 6.2 æ¨¡æ¿è¯­æ³•åŸºç¡€



Alertmanagerä½¿ç”¨Goçš„`text/template`è¯­æ³•ï¼š

**åŸºæœ¬è¯­æ³•**ï¼š
```go
{{ .CommonLabels.alertname }}     // è·å–æ ‡ç­¾å€¼
{{ .Alerts | len }}              // å‘Šè­¦æ•°é‡
{{ range .Alerts }}...{{ end }}  // éå†å‘Šè­¦
```

## 6.3 é‚®ä»¶æ¨¡æ¿ç¤ºä¾‹



```yaml
templates:
  - '/etc/alertmanager/templates/*.tmpl'

receivers:
  - name: 'email-alerts'
    email_configs:
      - to: 'ops@company.com'
        subject: 'ã€å‘Šè­¦ã€‘{{ .GroupLabels.alertname }} - {{ .Alerts | len }}æ¡'
        html: |
          <h2>å‘Šè­¦æ‘˜è¦</h2>
          <p><strong>å‘Šè­¦æ•°é‡:</strong> {{ .Alerts | len }}</p>
          <p><strong>è§¦å‘æ—¶é—´:</strong> {{ (index .Alerts 0).StartsAt }}</p>
          
          <h3>å‘Šè­¦è¯¦æƒ…</h3>
          <table border="1">
          <tr><th>å®ä¾‹</th><th>å‘Šè­¦</th><th>è¯¦æƒ…</th></tr>
          {{ range .Alerts }}
          <tr>
            <td>{{ .Labels.instance }}</td>
            <td>{{ .Labels.alertname }}</td>
            <td>{{ .Annotations.description }}</td>
          </tr>
          {{ end }}
          </table>
```

## 6.4 é’‰é’‰æ¶ˆæ¯æ¨¡æ¿



åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ `/etc/alertmanager/templates/dingtalk.tmpl`ï¼š

```go
{{ define "dingtalk.default" }}
{
  "msgtype": "markdown",
  "markdown": {
    "title": "Prometheuså‘Šè­¦",
    "text": "## {{ .GroupLabels.alertname }}\n\n**å‘Šè­¦æ•°é‡:** {{ .Alerts | len }}\n\n{{ range .Alerts }}**å®ä¾‹:** {{ .Labels.instance }}\n**çŠ¶æ€:** {{ .Status }}\n**è¯¦æƒ…:** {{ .Annotations.description }}\n\n{{ end }}"
  }
}
{{ end }}
```

ä½¿ç”¨æ¨¡æ¿ï¼š
```yaml
receivers:
  - name: 'dingtalk'
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=xxx'
        send_resolved: true
        body: '{{ template "dingtalk.default" . }}'
```

## 6.5 å¸¸ç”¨æ¨¡æ¿å˜é‡



| å˜é‡ | å«ä¹‰ | ç¤ºä¾‹ç”¨æ³• |
|------|------|----------|
| `.Alerts` | å‘Šè­¦åˆ—è¡¨ | `{{ .Alerts | len }}` |
| `.GroupLabels` | åˆ†ç»„æ ‡ç­¾ | `{{ .GroupLabels.alertname }}` |
| `.CommonLabels` | å…¬å…±æ ‡ç­¾ | `{{ .CommonLabels.instance }}` |
| `.Status` | å‘Šè­¦çŠ¶æ€ | `firing` æˆ– `resolved` |
| `.StartsAt` | å¼€å§‹æ—¶é—´ | æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º |

---

# 7. ğŸ”§ é«˜å¯ç”¨é›†ç¾¤é…ç½®



## 7.1 é«˜å¯ç”¨çš„å¿…è¦æ€§



**å•ç‚¹æ•…éšœé—®é¢˜**ï¼š
- AlertmanageræŒ‚äº† â†’ å‘Šè­¦å‘ä¸å‡ºå» â†’ é—®é¢˜å‘ç°ä¸åŠæ—¶

**é«˜å¯ç”¨æ–¹æ¡ˆ**ï¼š
- å¤šä¸ªAlertmanagerå®ä¾‹ â†’ ç›¸äº’å¤‡ä»½ â†’ ä¿è¯å‘Šè­¦å¯é æ€§

## 7.2 é›†ç¾¤æ¶æ„å›¾



```
         Prometheus
             |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        â”‚        â”‚
    â–¼        â–¼        â–¼
AMèŠ‚ç‚¹1   AMèŠ‚ç‚¹2   AMèŠ‚ç‚¹3
    â”‚        â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         é›†ç¾¤é€šä¿¡
         (Gossipåè®®)
```

## 7.3 é›†ç¾¤é…ç½®



**èŠ‚ç‚¹1é…ç½®** (`alertmanager1.yml`)ï¼š
```yaml
global:
#  # åŸºç¡€é…ç½®...

# é›†ç¾¤é…ç½®

cluster:
#  # æœ¬èŠ‚ç‚¹ç›‘å¬åœ°å€
  listen-address: "0.0.0.0:9094"
#  # å…¶ä»–èŠ‚ç‚¹åœ°å€
  peer: "alertmanager2:9094"
  peer: "alertmanager3:9094"

route:
#  # è·¯ç”±é…ç½®...
```

**å¯åŠ¨å‘½ä»¤**ï¼š
```bash
# èŠ‚ç‚¹1

./alertmanager \
  --config.file=alertmanager1.yml \
  --cluster.listen-address=0.0.0.0:9094 \
  --cluster.peer=alertmanager2:9094 \
  --cluster.peer=alertmanager3:9094

# èŠ‚ç‚¹2  

./alertmanager \
  --config.file=alertmanager2.yml \
  --cluster.listen-address=0.0.0.0:9094 \
  --cluster.peer=alertmanager1:9094 \
  --cluster.peer=alertmanager3:9094
```

## 7.4 è´Ÿè½½å‡è¡¡é…ç½®



**Nginxé…ç½®**ï¼š
```nginx
upstream alertmanager {
    server alertmanager1:9093;
    server alertmanager2:9093;
    server alertmanager3:9093;
}

server {
    listen 9093;
    location / {
        proxy_pass http://alertmanager;
    }
}
```

**Prometheusé…ç½®**ï¼š
```yaml
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager1:9093
          - alertmanager2:9093
          - alertmanager3:9093
```

## 7.5 é›†ç¾¤çŠ¶æ€æ£€æŸ¥



**æ£€æŸ¥é›†ç¾¤çŠ¶æ€**ï¼š
```bash
# æŸ¥çœ‹é›†ç¾¤æˆå‘˜

curl http://localhost:9093/api/v1/status

# æŸ¥çœ‹é›†ç¾¤åŒæ­¥çŠ¶æ€

curl http://localhost:9093/#/status
```

---

# 8. ğŸ–¥ï¸ Web UIç®¡ç†ç•Œé¢



## 8.1 Web UIåŠŸèƒ½ä»‹ç»



**è®¿é—®åœ°å€**ï¼š`http://localhost:9093`

**ä¸»è¦åŠŸèƒ½**ï¼š
- ğŸ“Š **å‘Šè­¦æŸ¥çœ‹**ï¼šå½“å‰æ´»è·ƒå‘Šè­¦åˆ—è¡¨
- ğŸ”‡ **é™é»˜ç®¡ç†**ï¼šåˆ›å»ºã€æŸ¥çœ‹ã€åˆ é™¤é™é»˜
- ğŸš¨ **å‘Šè­¦è¯¦æƒ…**ï¼šæŸ¥çœ‹å‘Šè­¦çš„è¯¦ç»†ä¿¡æ¯
- âš™ï¸ **é…ç½®çŠ¶æ€**ï¼šæŸ¥çœ‹å½“å‰é…ç½®æ˜¯å¦æœ‰æ•ˆ

## 8.2 å‘Šè­¦ç®¡ç†ç•Œé¢



**å‘Šè­¦åˆ—è¡¨é¡µé¢**ï¼š
- æ˜¾ç¤ºå½“å‰æ‰€æœ‰æ´»è·ƒå‘Šè­¦
- å¯ä»¥æŒ‰æ ‡ç­¾è¿‡æ»¤å‘Šè­¦
- æ˜¾ç¤ºå‘Šè­¦çš„å¼€å§‹æ—¶é—´ã€æŒç»­æ—¶é—´
- å¯ä»¥ç›´æ¥ä»ç•Œé¢åˆ›å»ºé™é»˜

**å‘Šè­¦è¯¦æƒ…**ï¼š
```
å‘Šè­¦ä¿¡æ¯å±•ç¤ºï¼š
â”Œâ”€ å‘Šè­¦åŸºæœ¬ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åç§°: HighCPU              â”‚
â”‚ çŠ¶æ€: Firing               â”‚
â”‚ å¼€å§‹: 2023-10-01 10:00:00  â”‚
â”‚ æŒç»­: 30åˆ†é’Ÿ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ æ ‡ç­¾ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ instance: web-server-01    â”‚
â”‚ job: node-exporter         â”‚  
â”‚ severity: warning          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ æ³¨é‡Šä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ summary: CPUä½¿ç”¨ç‡è¿‡é«˜      â”‚
â”‚ description: å½“å‰CPUä½¿ç”¨ç‡  â”‚
â”‚ 85%ï¼Œè¶…è¿‡å‘Šè­¦é˜ˆå€¼80%        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 8.3 é™é»˜ç®¡ç†



**åˆ›å»ºé™é»˜**ï¼š
1. åœ¨å‘Šè­¦åˆ—è¡¨ç‚¹å‡»"Silence"æŒ‰é’®
2. å¡«å†™é™é»˜æ¡ä»¶ï¼ˆæ ‡ç­¾åŒ¹é…ï¼‰
3. è®¾ç½®é™é»˜æ—¶é—´
4. æ·»åŠ é™é»˜åŸå› è¯´æ˜

**é™é»˜åˆ—è¡¨æ˜¾ç¤º**ï¼š
- é™é»˜çš„åŒ¹é…æ¡ä»¶
- é™é»˜çš„å¼€å§‹å’Œç»“æŸæ—¶é—´  
- åˆ›å»ºè€…å’Œé™é»˜åŸå› 
- é™é»˜çŠ¶æ€ï¼ˆActive/Expiredï¼‰

## 8.4 é…ç½®éªŒè¯



**é…ç½®çŠ¶æ€é¡µé¢**ï¼š`http://localhost:9093/#/status`

æ˜¾ç¤ºä¿¡æ¯ï¼š
- é…ç½®æ–‡ä»¶åŠ è½½çŠ¶æ€ âœ…/âŒ
- é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯
- è¿è¡Œæ—¶é—´å’Œç‰ˆæœ¬ä¿¡æ¯
- é…ç½®æ–‡ä»¶è·¯å¾„

**é…ç½®æ£€æŸ¥å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•

./amtool config check alertmanager.yml

# æ˜¾ç¤ºå½“å‰é…ç½®

./amtool config show
```

---

# 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ



```
ğŸ”¸ é…ç½®æ–‡ä»¶ç»“æ„ï¼šglobalã€routeã€receiversã€inhibit_ruleså››å¤§éƒ¨åˆ†
ğŸ”¸ è·¯ç”±æœºåˆ¶ï¼šæ ¹æ®å‘Šè­¦æ ‡ç­¾åŒ¹é…å¯¹åº”çš„æ¥æ”¶å™¨  
ğŸ”¸ åˆ†ç»„å»é‡ï¼šåˆå¹¶ç›¸åŒç±»å‹å‘Šè­¦ï¼Œé¿å…å‘Šè­¦è½°ç‚¸
ğŸ”¸ æŠ‘åˆ¶é™é»˜ï¼šä¸»åŠ¨æ§åˆ¶å‘Šè­¦å‘é€ï¼Œå‡å°‘å™ªéŸ³
ğŸ”¸ æ¨¡æ¿å®šåˆ¶ï¼šç¾åŒ–å‘Šè­¦å†…å®¹ï¼Œæä¾›æ›´å¤šä¿¡æ¯
ğŸ”¸ é«˜å¯ç”¨é›†ç¾¤ï¼šå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œä¿è¯æœåŠ¡å¯é æ€§
```

## 9.2 å…³é”®é…ç½®ç†è§£è¦ç‚¹



**ğŸ”¹ è·¯ç”±é…ç½®æ ¸å¿ƒæ€è·¯**ï¼š
- ä»ä¸Šåˆ°ä¸‹åŒ¹é…ï¼Œå…ˆåŒ¹é…å…ˆç”Ÿæ•ˆ
- é»˜è®¤receiverä½œä¸ºå…œåº•æ–¹æ¡ˆ
- æ—¶é—´å‚æ•°æ§åˆ¶å‘Šè­¦å‘é€é¢‘ç‡

**ğŸ”¹ é€šçŸ¥æ–¹å¼é€‰æ‹©åŸåˆ™**ï¼š
- é‚®ä»¶ï¼šé€‚åˆè¯¦ç»†ä¿¡æ¯å’Œè®°å½•å­˜æ¡£
- IM(Slack/é’‰é’‰)ï¼šé€‚åˆæ—¥å¸¸å‘Šè­¦å’Œå›¢é˜Ÿåä½œ  
- çŸ­ä¿¡/ç”µè¯ï¼šé€‚åˆç´§æ€¥å‘Šè­¦
- Webhookï¼šé€‚åˆç³»ç»Ÿé›†æˆ

**ğŸ”¹ åˆ†ç»„ç­–ç•¥æœ€ä½³å®è·µ**ï¼š
```
åˆ†ç»„ç²’åº¦ï¼š
- å¤ªç²— â†’ ä¸ç›¸å…³å‘Šè­¦æ··åœ¨ä¸€èµ·
- å¤ªç»† â†’ å¤±å»åˆ†ç»„åˆå¹¶æ•ˆæœ
- åˆšå¥½ â†’ ç›¸å…³å‘Šè­¦åˆå¹¶ï¼Œä¸ç›¸å…³åˆ†å¼€
```

## 9.3 å®é™…è¿ç»´ä»·å€¼



**ğŸ¯ ä¸šåŠ¡ä»·å€¼**ï¼š
- **é™å™ªå¢æ•ˆ**ï¼šé€šè¿‡åˆ†ç»„ã€æŠ‘åˆ¶å‡å°‘å‘Šè­¦å™ªéŸ³
- **å¿«é€Ÿå“åº”**ï¼šå‘Šè­¦ç›´è¾¾è´£ä»»å›¢é˜Ÿ
- **æœåŠ¡å¯é **ï¼šé«˜å¯ç”¨ä¿è¯å‘Šè­¦ä¸ä¸¢å¤±
- **è¿ç»´ææ•ˆ**ï¼šWebç•Œé¢æ–¹ä¾¿ç®¡ç†å’Œæ’æŸ¥

**ğŸ”§ è¿ç»´å®è·µ**ï¼š
- **é…ç½®ç®¡ç†**ï¼šç‰ˆæœ¬æ§åˆ¶é…ç½®æ–‡ä»¶ï¼Œå˜æ›´å¯å›æ»š
- **æµ‹è¯•éªŒè¯**ï¼šæ–°é…ç½®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
- **ç›‘æ§è‡ªèº«**ï¼šç›‘æ§Alertmanagerè‡ªå·±çš„çŠ¶æ€
- **å‘Šè­¦æ¼”ç»ƒ**ï¼šå®šæœŸæµ‹è¯•å‘Šè­¦é€šçŸ¥æ˜¯å¦æ­£å¸¸

## 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³



**ğŸš¨ é—®é¢˜1ï¼šå‘Šè­¦å‘ä¸å‡ºå»**
```
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥Alertmanageræ—¥å¿—
2. éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•  
3. ç¡®è®¤ç½‘ç»œè¿é€šæ€§
4. æµ‹è¯•æ¥æ”¶å™¨é…ç½®
```

**ğŸš¨ é—®é¢˜2ï¼šå‘Šè­¦å¤ªå¤šå¤ªé¢‘ç¹**
```
ä¼˜åŒ–æ–¹æ¡ˆï¼š
1. è°ƒæ•´åˆ†ç»„ç­–ç•¥åˆå¹¶å‘Šè­¦
2. å¢åŠ group_waitæ—¶é—´  
3. è®¾ç½®åˆç†çš„repeat_interval
4. ä½¿ç”¨æŠ‘åˆ¶è§„åˆ™å‡å°‘è¡ç”Ÿå‘Šè­¦
```

**ğŸš¨ é—®é¢˜3ï¼šé‡è¦å‘Šè­¦è¢«æ·¹æ²¡**
```
è§£å†³æ–¹æ³•ï¼š
1. ä¸¥é‡å‘Šè­¦å•ç‹¬è·¯ç”±
2. ä¸åŒä¸¥é‡ç¨‹åº¦ç”¨ä¸åŒé€šçŸ¥æ–¹å¼
3. ç´§æ€¥å‘Šè­¦ç¼©çŸ­group_waitæ—¶é—´
4. ä½¿ç”¨å‘Šè­¦ä¼˜å…ˆçº§åˆ†çº§å¤„ç†
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Alertmanageræ˜¯å‘Šè­¦çš„"é‚®å±€åˆ†æ‹£å‘˜"
- è·¯ç”±å†³å®šå‘ç»™è°ï¼Œæ¥æ”¶å™¨å†³å®šæ€ä¹ˆå‘
- åˆ†ç»„åˆå¹¶å‘Šè­¦ï¼ŒæŠ‘åˆ¶å‡å°‘å™ªéŸ³  
- é«˜å¯ç”¨ä¿å¯é ï¼Œæ¨¡æ¿è®©å‘Šè­¦æ›´ç¾è§‚