---
title: 11ã€å®šæ—¶ä»»åŠ¡æ—¥å¿—ä¸ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [å®šæ—¶ä»»åŠ¡æ—¥å¿—ç³»ç»Ÿæ¦‚è¿°](#1-å®šæ—¶ä»»åŠ¡æ—¥å¿—ç³»ç»Ÿæ¦‚è¿°)
2. [cronæ—¥å¿—æ–‡ä»¶è¯¦è§£](#2-cronæ—¥å¿—æ–‡ä»¶è¯¦è§£)
3. [systemd timeræ—¥å¿—ç®¡ç†](#3-systemd-timeræ—¥å¿—ç®¡ç†)
4. [ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€è®°å½•](#4-ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€è®°å½•)
5. [é‚®ä»¶é€šçŸ¥é…ç½®æ–¹æ³•](#5-é‚®ä»¶é€šçŸ¥é…ç½®æ–¹æ³•)
6. [ä»»åŠ¡è¾“å‡ºé‡å®šå‘æŠ€å·§](#6-ä»»åŠ¡è¾“å‡ºé‡å®šå‘æŠ€å·§)
7. [é”™è¯¯ä¿¡æ¯æ”¶é›†åˆ†æ](#7-é”™è¯¯ä¿¡æ¯æ”¶é›†åˆ†æ)
8. [ä»»åŠ¡æ‰§è¡Œæ—¶é—´ç»Ÿè®¡](#8-ä»»åŠ¡æ‰§è¡Œæ—¶é—´ç»Ÿè®¡)
9. [å¼‚å¸¸ä»»åŠ¡å‘Šè­¦æœºåˆ¶](#9-å¼‚å¸¸ä»»åŠ¡å‘Šè­¦æœºåˆ¶)
10. [æ—¥å¿—ç»´æŠ¤ä¸ä¼˜åŒ–](#10-æ—¥å¿—ç»´æŠ¤ä¸ä¼˜åŒ–)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å®šæ—¶ä»»åŠ¡æ—¥å¿—ç³»ç»Ÿæ¦‚è¿°


### 1.1 æ—¥å¿—ç³»ç»Ÿçš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§å®šæ—¶ä»»åŠ¡**
```
è¿ç»´ç—›ç‚¹ï¼š
- ä»»åŠ¡é™é»˜å¤±è´¥ï¼šcronä»»åŠ¡å¤±è´¥äº†ä½†æ²¡äººçŸ¥é“
- æ€§èƒ½é—®é¢˜ï¼šæŸä¸ªä»»åŠ¡å ç”¨è¿‡å¤šèµ„æºå½±å“ç³»ç»Ÿ
- ä¾èµ–å…³ç³»ï¼šä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å¯¼è‡´è¿é”æ•…éšœ
- å®¡è®¡éœ€æ±‚ï¼šéœ€è¦è¿½è¸ªä»»åŠ¡çš„æ‰§è¡Œå†å²

ç›‘æ§è§£å†³çš„é—®é¢˜ï¼š
âœ… åŠæ—¶å‘ç°ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸
âœ… åˆ†æä»»åŠ¡æ€§èƒ½å’Œèµ„æºæ¶ˆè€—
âœ… æä¾›æ•…éšœæ’æŸ¥çš„ä¾æ®
âœ… æ»¡è¶³åˆè§„å’Œå®¡è®¡è¦æ±‚
```

### 1.2 Linuxå®šæ—¶ä»»åŠ¡æ—¥å¿—æ¶æ„


```
å®šæ—¶ä»»åŠ¡æ—¥å¿—ç”Ÿæ€ç³»ç»Ÿï¼š

ç³»ç»Ÿå±‚æ—¥å¿—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /var/log/   â”‚â”€â”€â”€â–¶â”‚  rsyslog/   â”‚â”€â”€â”€â–¶â”‚   å¤–éƒ¨æ—¥å¿—  â”‚
â”‚   cron      â”‚    â”‚  systemd    â”‚    â”‚   ç³»ç»Ÿ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åº”ç”¨å±‚æ—¥å¿—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»»åŠ¡è„šæœ¬    â”‚â”€â”€â”€â–¶â”‚  é‡å®šå‘åˆ°   â”‚â”€â”€â”€â–¶â”‚  è‡ªå®šä¹‰æ—¥å¿— â”‚
â”‚ è¾“å‡º        â”‚    â”‚  æ–‡ä»¶       â”‚    â”‚  æ–‡ä»¶       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é€šçŸ¥ç³»ç»Ÿï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é‚®ä»¶é€šçŸ¥   â”‚â—„â”€â”€â”€â”‚  ç›‘æ§è„šæœ¬   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ—¥å¿—ç±»å‹åˆ†ç±»


| æ—¥å¿—ç±»å‹ | **å­˜å‚¨ä½ç½®** | **è®°å½•å†…å®¹** | **æŸ¥çœ‹æ–¹å¼** |
|---------|-------------|-------------|-------------|
| ğŸ“‹ **cronç³»ç»Ÿæ—¥å¿—** | `/var/log/cron` | `ä»»åŠ¡è°ƒåº¦ã€å¯åŠ¨åœæ­¢` | `tail/grep/less` |
| âš¡ **systemdæ—¥å¿—** | `journald` | `timerå•å…ƒçŠ¶æ€` | `journalctl` |
| ğŸ“ **ä»»åŠ¡è¾“å‡ºæ—¥å¿—** | `è‡ªå®šä¹‰ä½ç½®` | `è„šæœ¬æ‰§è¡Œç»“æœ` | `é‡å®šå‘é…ç½®` |
| ğŸ“§ **é‚®ä»¶é€šçŸ¥** | `é‚®ç®±/æœ¬åœ°é‚®ä»¶` | `ä»»åŠ¡æ‰§è¡Œæ‘˜è¦` | `mailå‘½ä»¤` |
| âš ï¸ **é”™è¯¯æ—¥å¿—** | `/var/log/messages` | `ç³»ç»Ÿçº§é”™è¯¯ä¿¡æ¯` | `ç³»ç»Ÿæ—¥å¿—å·¥å…·` |

---

## 2. ğŸ“‚ cronæ—¥å¿—æ–‡ä»¶è¯¦è§£


### 2.1 cronæ—¥å¿—æ–‡ä»¶ä½ç½®


**ğŸ”¸ ä¸»è¦æ—¥å¿—æ–‡ä»¶**
```
Ubuntu/Debianç³»ç»Ÿï¼š
/var/log/cron.log          # ä¸»è¦cronæ—¥å¿—æ–‡ä»¶
/var/log/syslog            # ç³»ç»Ÿç»¼åˆæ—¥å¿—ï¼ˆåŒ…å«cronä¿¡æ¯ï¼‰

CentOS/RHELç³»ç»Ÿï¼š
/var/log/cron              # ä¸“é—¨çš„cronæ—¥å¿—
/var/log/messages          # ç³»ç»Ÿæ¶ˆæ¯æ—¥å¿—
/var/log/secure            # å®‰å…¨ç›¸å…³æ—¥å¿—ï¼ˆåŒ…å«ç”¨æˆ·cronæ“ä½œï¼‰

æ³¨æ„å·®å¼‚ï¼š
ä¸åŒå‘è¡Œç‰ˆçš„æ—¥å¿—æ–‡ä»¶ä½ç½®å¯èƒ½ä¸åŒ
æŸäº›ç³»ç»Ÿå¯èƒ½éœ€è¦æ‰‹åŠ¨å¯ç”¨cronæ—¥å¿—è®°å½•
```

### 2.2 cronæ—¥å¿—æ ¼å¼è§£æ


**ğŸ“‹ æ ‡å‡†æ—¥å¿—æ ¼å¼**
```
å…¸å‹cronæ—¥å¿—æ¡ç›®ï¼š
Sep 17 10:30:01 server01 CRON[12345]: (root) CMD (backup_script.sh)
Sep 17 10:30:02 server01 CRON[12345]: (root) CMDEND (backup_script.sh)

å­—æ®µè§£é‡Šï¼š
Sep 17 10:30:01  â† æ—¶é—´æˆ³
server01         â† ä¸»æœºå
CRON[12345]     â† è¿›ç¨‹åå’ŒPID
(root)          â† æ‰§è¡Œç”¨æˆ·
CMD             â† åŠ¨ä½œç±»å‹
(backup_script.sh) â† æ‰§è¡Œçš„å‘½ä»¤

å¸¸è§åŠ¨ä½œç±»å‹ï¼š
CMD     - ä»»åŠ¡å¼€å§‹æ‰§è¡Œ
CMDEND  - ä»»åŠ¡æ‰§è¡Œç»“æŸ
START   - cronå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨
RELOAD  - é‡æ–°åŠ è½½é…ç½®
```

### 2.3 cronæ—¥å¿—æŸ¥çœ‹æ–¹æ³•


**ğŸ” åŸºç¡€æŸ¥çœ‹å‘½ä»¤**
```bash
# æŸ¥çœ‹æœ€è¿‘çš„cronæ—¥å¿—
tail -f /var/log/cron

# æŸ¥çœ‹ä»Šå¤©çš„cronæ‰§è¡Œè®°å½•
grep "$(date '+%b %d')" /var/log/cron

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„ä»»åŠ¡æ‰§è¡Œ
grep "(username)" /var/log/cron

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
sed -n '/Sep 17 10:00/,/Sep 17 11:00/p' /var/log/cron
```

### 2.4 å¯ç”¨è¯¦ç»†cronæ—¥å¿—


**âš™ï¸ é…ç½®cronæ—¥å¿—è®°å½•**
```bash
# Ubuntuç³»ç»Ÿå¯ç”¨cronæ—¥å¿—
sudo vim /etc/rsyslog.d/50-default.conf
# å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œï¼š
# cron.*                         /var/log/cron.log

# é‡å¯rsyslogæœåŠ¡
sudo systemctl restart rsyslog

# CentOSç³»ç»Ÿæ£€æŸ¥é…ç½®
grep cron /etc/rsyslog.conf
# åº”è¯¥åŒ…å«ï¼šcron.* /var/log/cron

# éªŒè¯æ—¥å¿—è®°å½•æ˜¯å¦æ­£å¸¸
logger -p cron.info "Test cron log message"
tail /var/log/cron
```

---

## 3. âš¡ systemd timeræ—¥å¿—ç®¡ç†


### 3.1 ä½¿ç”¨journalctlæŸ¥çœ‹timeræ—¥å¿—


**ğŸ”¸ åŸºæœ¬æŸ¥çœ‹å‘½ä»¤**
```bash
# æŸ¥çœ‹æ‰€æœ‰timerå•å…ƒçŠ¶æ€
systemctl list-timers --all

# æŸ¥çœ‹ç‰¹å®štimerçš„æ—¥å¿—
journalctl -u mybackup.timer

# å®æ—¶è·Ÿè¸ªtimeræ—¥å¿—
journalctl -u mybackup.timer -f

# æŸ¥çœ‹timerå…³è”çš„serviceæ—¥å¿—
journalctl -u mybackup.service
```

### 3.2 timeræ—¥å¿—è¯¦ç»†æŸ¥çœ‹


**ğŸ“Š é«˜çº§æ—¥å¿—æŸ¥è¯¢**
```bash
# æŸ¥çœ‹æœ€è¿‘24å°æ—¶çš„timeræ´»åŠ¨
journalctl --since "24 hours ago" -u "*.timer"

# æŸ¥çœ‹timeræ‰§è¡Œç»Ÿè®¡
journalctl -u mybackup.timer --since "1 week ago" --grep="Started\|Finished"

# æŒ‰æ—¶é—´èŒƒå›´æŸ¥çœ‹
journalctl -u mybackup.timer --since "2023-09-01" --until "2023-09-17"

# æŸ¥çœ‹é”™è¯¯çº§åˆ«çš„æ—¥å¿—
journalctl -u mybackup.service -p err

# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯åŒ…æ‹¬ç¯å¢ƒå˜é‡
journalctl -u mybackup.service -o verbose
```

### 3.3 timerçŠ¶æ€åˆ†æ


**ğŸ”§ ç†è§£timerçŠ¶æ€ä¿¡æ¯**
```bash
# è·å–timerè¯¦ç»†çŠ¶æ€
systemctl status mybackup.timer

# è¾“å‡ºç¤ºä¾‹è§£è¯»ï¼š
â— mybackup.timer - Daily Backup Timer
   Loaded: loaded (/etc/systemd/system/mybackup.timer; enabled)
   Active: active (waiting) since Mon 2023-09-17 09:00:00 CST; 2h ago
  Trigger: Tue 2023-09-18 02:00:00 CST; 17h left
     Docs: man:systemd.timer(5)

å…³é”®çŠ¶æ€è¯´æ˜ï¼š
- Active: active (waiting) â†’ timeræ­£åœ¨ç­‰å¾…è§¦å‘
- Trigger: ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
- Last trigger: ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´ï¼ˆå¦‚æœæœ‰ï¼‰
```

### 3.4 é…ç½®timeræ—¥å¿—çº§åˆ«


**âš™ï¸ è‡ªå®šä¹‰æ—¥å¿—è¯¦ç»†ç¨‹åº¦**
```bash
# åœ¨serviceæ–‡ä»¶ä¸­é…ç½®æ—¥å¿—çº§åˆ«
sudo vim /etc/systemd/system/mybackup.service

[Unit]
Description=Backup Service

[Service]
Type=oneshot
ExecStart=/opt/scripts/backup.sh
StandardOutput=journal
StandardError=journal
SyslogIdentifier=mybackup

# é‡è½½é…ç½®
sudo systemctl daemon-reload
```

---

## 4. âœ… ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€è®°å½•


### 4.1 æˆåŠŸæ‰§è¡Œè®°å½•


**ğŸ“ è¯†åˆ«æˆåŠŸæ‰§è¡Œçš„æ ‡å¿—**
```
cronæ—¥å¿—ä¸­çš„æˆåŠŸæ ‡å¿—ï¼š
CMDEND (command) - è¡¨ç¤ºå‘½ä»¤æ‰§è¡Œå®Œæˆ
è¿”å›ç ä¸º0 - åœ¨è¯¦ç»†æ—¥å¿—ä¸­æ˜¾ç¤º

systemd timeræˆåŠŸæ ‡å¿—ï¼š
Started service_name - æœåŠ¡å¼€å§‹æ‰§è¡Œ
Finished service_name - æœåŠ¡æ‰§è¡Œå®Œæˆ
Main PID: exited, code=exited, status=0 - æ­£å¸¸é€€å‡º

åˆ¤æ–­æ ‡å‡†ï¼š
âœ… æ²¡æœ‰é”™è¯¯ä¿¡æ¯
âœ… è¿›ç¨‹æ­£å¸¸é€€å‡ºï¼ˆè¿”å›ç 0ï¼‰
âœ… åœ¨é¢„æœŸæ—¶é—´å†…å®Œæˆ
```

### 4.2 å¤±è´¥æ‰§è¡Œè®°å½•åˆ†æ


**âŒ å¤±è´¥æƒ…å†µè¯†åˆ«**
```
å¸¸è§å¤±è´¥æ¨¡å¼ï¼š

æƒé™é—®é¢˜ï¼š
Permission denied - æƒé™ä¸è¶³
Operation not permitted - æ“ä½œä¸è¢«å…è®¸

æ–‡ä»¶é—®é¢˜ï¼š
No such file or directory - æ–‡ä»¶ä¸å­˜åœ¨
Cannot open file - æ–‡ä»¶æ— æ³•æ‰“å¼€

èµ„æºé—®é¢˜ï¼š
Cannot allocate memory - å†…å­˜ä¸è¶³
No space left on device - ç£ç›˜ç©ºé—´ä¸è¶³

ç½‘ç»œé—®é¢˜ï¼š
Connection refused - è¿æ¥è¢«æ‹’ç»
Network unreachable - ç½‘ç»œä¸å¯è¾¾
```

### 4.3 ä»»åŠ¡çŠ¶æ€è¿½è¸ªè„šæœ¬


**ğŸ”§ è‡ªåŠ¨åŒ–çŠ¶æ€è®°å½•**
```bash
#!/bin/bash
# task_monitor.sh - ä»»åŠ¡çŠ¶æ€è®°å½•è„šæœ¬

TASK_NAME="$1"
LOG_FILE="/var/log/task_status.log"
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

log_status() {
    local status="$1"
    local message="$2"
    echo "[$TIMESTAMP] $TASK_NAME: $status - $message" >> "$LOG_FILE"
}

# ä»»åŠ¡å¼€å§‹è®°å½•
log_status "START" "Task execution begins"

# æ‰§è¡Œå®é™…ä»»åŠ¡
if "$@"; then
    log_status "SUCCESS" "Task completed successfully"
    exit 0
else
    log_status "FAILED" "Task failed with exit code $?"
    exit 1
fi
```

### 4.4 çŠ¶æ€ç»Ÿè®¡æŸ¥è¯¢


**ğŸ“Š ç”Ÿæˆæ‰§è¡Œç»Ÿè®¡æŠ¥å‘Š**
```bash
# ç»Ÿè®¡æœ€è¿‘ä¸€å‘¨çš„ä»»åŠ¡æˆåŠŸç‡
#!/bin/bash
# task_stats.sh

LOG_FILE="/var/log/task_status.log"
DAYS=7

echo "=== æœ€è¿‘${DAYS}å¤©ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡ ==="
echo

# è·å–æ—¶é—´èŒƒå›´
start_date=$(date -d "${DAYS} days ago" '+%Y-%m-%d')
today=$(date '+%Y-%m-%d')

# ç»Ÿè®¡æ€»æ‰§è¡Œæ¬¡æ•°
total=$(grep -c "START" "$LOG_FILE" | grep -E "$start_date|$today" | wc -l)

# ç»Ÿè®¡æˆåŠŸæ¬¡æ•°
success=$(grep -c "SUCCESS" "$LOG_FILE" | grep -E "$start_date|$today" | wc -l)

# è®¡ç®—æˆåŠŸç‡
if [ "$total" -gt 0 ]; then
    success_rate=$(echo "scale=2; $success * 100 / $total" | bc)
    echo "æ€»æ‰§è¡Œæ¬¡æ•°: $total"
    echo "æˆåŠŸæ¬¡æ•°: $success"
    echo "æˆåŠŸç‡: ${success_rate}%"
else
    echo "æ— æ‰§è¡Œè®°å½•"
fi
```

---

## 5. ğŸ“§ é‚®ä»¶é€šçŸ¥é…ç½®æ–¹æ³•


### 5.1 ç³»ç»Ÿé‚®ä»¶æœåŠ¡é…ç½®


**ğŸ”¸ å®‰è£…å’Œé…ç½®é‚®ä»¶æœåŠ¡**
```bash
# Ubuntu/Debianå®‰è£…é‚®ä»¶æœåŠ¡
sudo apt install postfix mailutils

# CentOS/RHELå®‰è£…é‚®ä»¶æœåŠ¡
sudo yum install postfix mailx

# é…ç½®postfixåŸºæœ¬è®¾ç½®
sudo vim /etc/postfix/main.cf

# å…³é”®é…ç½®é¡¹ï¼š
myhostname = your-server.domain.com
mydomain = domain.com
myorigin = $mydomain
relayhost = [smtp.domain.com]:587

# å¯åŠ¨é‚®ä»¶æœåŠ¡
sudo systemctl enable postfix
sudo systemctl start postfix
```

### 5.2 croné‚®ä»¶é€šçŸ¥æœºåˆ¶


**ğŸ“® cronå†…ç½®é‚®ä»¶åŠŸèƒ½**
```bash
# è®¾ç½®é‚®ä»¶æ¥æ”¶è€…
# åœ¨crontabå¼€å¤´æ·»åŠ ï¼š
MAILTO=admin@example.com

# ç¤ºä¾‹crontabé…ç½®ï¼š
SHELL=/bin/bash
PATH=/usr/local/bin:/usr/bin:/bin
MAILTO=admin@example.com

# æ¯å¤©2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼Œæœ‰è¾“å‡ºå°±å‘é‚®ä»¶
0 2 * * * /opt/scripts/backup.sh

# åªåœ¨å‡ºé”™æ—¶å‘é‚®ä»¶
0 3 * * * /opt/scripts/cleanup.sh 2>&1 | grep -i error && mail -s "Cleanup Error" admin@example.com

# ç¦ç”¨æŸä¸ªä»»åŠ¡çš„é‚®ä»¶é€šçŸ¥
0 4 * * * /opt/scripts/routine.sh >/dev/null 2>&1
```

### 5.3 è‡ªå®šä¹‰é‚®ä»¶é€šçŸ¥è„šæœ¬


**âœ‰ï¸ å¢å¼ºçš„é‚®ä»¶é€šçŸ¥åŠŸèƒ½**
```bash
#!/bin/bash
# enhanced_mail_notify.sh - å¢å¼ºé‚®ä»¶é€šçŸ¥

SCRIPT_NAME="$1"
RECIPIENT="admin@example.com"
HOSTNAME=$(hostname)
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

send_notification() {
    local status="$1"
    local details="$2"
    local subject="[$HOSTNAME] Task $status: $SCRIPT_NAME"
    
    cat > /tmp/mail_body << EOF
ä»»åŠ¡æ‰§è¡ŒæŠ¥å‘Š
================
æœåŠ¡å™¨: $HOSTNAME
ä»»åŠ¡åç§°: $SCRIPT_NAME
æ‰§è¡Œæ—¶é—´: $TIMESTAMP
çŠ¶æ€: $status

è¯¦ç»†ä¿¡æ¯:
$details

---
è‡ªåŠ¨ç”Ÿæˆçš„é‚®ä»¶é€šçŸ¥
EOF
    
    mail -s "$subject" "$RECIPIENT" < /tmp/mail_body
    rm -f /tmp/mail_body
}

# åŒ…è£…æ‰§è¡Œä»»åŠ¡
if output=$("${@:2}" 2>&1); then
    # æˆåŠŸæ—¶åªåœ¨æœ‰é‡è¦è¾“å‡ºæ—¶å‘é€
    if echo "$output" | grep -qi "error\|warning\|critical"; then
        send_notification "SUCCESS (with warnings)" "$output"
    fi
else
    # å¤±è´¥æ—¶æ€»æ˜¯å‘é€é‚®ä»¶
    send_notification "FAILED" "$output"
    exit 1
fi
```

### 5.4 HTMLæ ¼å¼é‚®ä»¶æŠ¥å‘Š


**ğŸ¨ ç¾åŒ–çš„é‚®ä»¶æŠ¥å‘Š**
```bash
#!/bin/bash
# html_mail_report.sh - HTMLæ ¼å¼é‚®ä»¶æŠ¥å‘Š

generate_html_report() {
    local task_name="$1"
    local status="$2"
    local start_time="$3"
    local end_time="$4"
    local output="$5"
    
    cat > /tmp/report.html << EOF
<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background-color: #f4f4f4; padding: 10px; border-radius: 5px; }
        .success { color: #28a745; }
        .failed { color: #dc3545; }
        .details { background-color: #f8f9fa; padding: 15px; border-left: 4px solid #007bff; }
        pre { background-color: #f1f1f1; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="header">
        <h2>ä»»åŠ¡æ‰§è¡ŒæŠ¥å‘Š</h2>
        <p><strong>æœåŠ¡å™¨:</strong> $(hostname)</p>
        <p><strong>ä»»åŠ¡:</strong> $task_name</p>
        <p><strong>çŠ¶æ€:</strong> <span class="$([[ $status == "SUCCESS" ]] && echo "success" || echo "failed")">$status</span></p>
    </div>
    
    <div class="details">
        <h3>æ‰§è¡Œè¯¦æƒ…</h3>
        <p><strong>å¼€å§‹æ—¶é—´:</strong> $start_time</p>
        <p><strong>ç»“æŸæ—¶é—´:</strong> $end_time</p>
        <h4>è¾“å‡ºå†…å®¹:</h4>
        <pre>$output</pre>
    </div>
</body>
</html>
EOF
    
    mail -a "Content-Type: text/html" -s "[$status] $task_name Report" admin@example.com < /tmp/report.html
    rm -f /tmp/report.html
}
```

---

## 6. ğŸ“¤ ä»»åŠ¡è¾“å‡ºé‡å®šå‘æŠ€å·§


### 6.1 åŸºç¡€é‡å®šå‘æ–¹æ³•


**ğŸ”¸ æ ‡å‡†é‡å®šå‘è¯­æ³•**
```bash
# åŸºæœ¬é‡å®šå‘ç¬¦å·å«ä¹‰ï¼š
>   é‡å®šå‘æ ‡å‡†è¾“å‡ºï¼ˆè¦†ç›–ï¼‰
>>  é‡å®šå‘æ ‡å‡†è¾“å‡ºï¼ˆè¿½åŠ ï¼‰
2>  é‡å®šå‘æ ‡å‡†é”™è¯¯ï¼ˆè¦†ç›–ï¼‰  
2>> é‡å®šå‘æ ‡å‡†é”™è¯¯ï¼ˆè¿½åŠ ï¼‰
&>  é‡å®šå‘æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯ï¼ˆè¦†ç›–ï¼‰
&>> é‡å®šå‘æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯ï¼ˆè¿½åŠ ï¼‰

# å®é™…åº”ç”¨ç¤ºä¾‹ï¼š
# æˆåŠŸè¾“å‡ºè®°å½•åˆ°æ—¥å¿—ï¼Œé”™è¯¯è¾“å‡ºè®°å½•åˆ°é”™è¯¯æ—¥å¿—
0 2 * * * /opt/backup.sh >> /var/log/backup.log 2>> /var/log/backup_error.log

# æ‰€æœ‰è¾“å‡ºéƒ½è®°å½•åˆ°åŒä¸€æ–‡ä»¶
0 3 * * * /opt/cleanup.sh >> /var/log/cleanup.log 2>&1

# ä¸¢å¼ƒæ‰€æœ‰è¾“å‡ºï¼ˆé™é»˜è¿è¡Œï¼‰
0 4 * * * /opt/routine.sh >/dev/null 2>&1
```

### 6.2 æ—¶é—´æˆ³æ—¥å¿—è®°å½•


**â° æ·»åŠ æ—¶é—´æˆ³åˆ°æ—¥å¿—**
```bash
# æ–¹æ³•1ï¼šåœ¨è„šæœ¬å†…éƒ¨æ·»åŠ æ—¶é—´æˆ³
#!/bin/bash
# backup_with_timestamp.sh

echo "$(date '+%Y-%m-%d %H:%M:%S') - Backup started"
# æ‰§è¡Œå¤‡ä»½æ“ä½œ
rsync -av /data/ /backup/
echo "$(date '+%Y-%m-%d %H:%M:%S') - Backup completed"

# æ–¹æ³•2ï¼šä½¿ç”¨ç®¡é“æ·»åŠ æ—¶é—´æˆ³
0 2 * * * /opt/backup.sh 2>&1 | while read line; do echo "$(date '+%Y-%m-%d %H:%M:%S') $line"; done >> /var/log/backup.log

# æ–¹æ³•3ï¼šä½¿ç”¨loggerå‘½ä»¤
0 3 * * * /opt/cleanup.sh 2>&1 | logger -t "cleanup-task"
```

### 6.3 æ—¥å¿—è½®è½¬é…ç½®


**ğŸ”„ é˜²æ­¢æ—¥å¿—æ–‡ä»¶è¿‡å¤§**
```bash
# åˆ›å»ºlogrotateé…ç½®æ–‡ä»¶
sudo vim /etc/logrotate.d/cron-tasks

# é…ç½®å†…å®¹ï¼š
/var/log/backup.log
/var/log/cleanup.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
    postrotate
        # é€šçŸ¥ç›¸å…³æœåŠ¡é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶
        /bin/systemctl reload rsyslog > /dev/null 2>&1 || true
    endscript
}
```

### 6.4 åˆ†ç±»è¾“å‡ºé‡å®šå‘


**ğŸ“‚ æŒ‰ç±»å‹åˆ†ç¦»è¾“å‡º**
```bash
#!/bin/bash
# categorized_logging.sh - åˆ†ç±»æ—¥å¿—è®°å½•

TASK_NAME="backup"
LOG_DIR="/var/log/tasks"
DATE=$(date '+%Y%m%d')

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p "$LOG_DIR"

# å®šä¹‰æ—¥å¿—æ–‡ä»¶
SUCCESS_LOG="$LOG_DIR/${TASK_NAME}_success_${DATE}.log"
ERROR_LOG="$LOG_DIR/${TASK_NAME}_error_${DATE}.log"
INFO_LOG="$LOG_DIR/${TASK_NAME}_info_${DATE}.log"

# æ—¥å¿—è®°å½•å‡½æ•°
log_info() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') [INFO] $1" | tee -a "$INFO_LOG"
}

log_success() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') [SUCCESS] $1" | tee -a "$SUCCESS_LOG"
}

log_error() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') [ERROR] $1" | tee -a "$ERROR_LOG" >&2
}

# ä½¿ç”¨ç¤ºä¾‹
log_info "Backup task started"
if rsync -av /data/ /backup/ >> "$INFO_LOG" 2>> "$ERROR_LOG"; then
    log_success "Backup completed successfully"
else
    log_error "Backup failed"
    exit 1
fi
```

---

## 7. ğŸš¨ é”™è¯¯ä¿¡æ¯æ”¶é›†åˆ†æ


### 7.1 å¸¸è§é”™è¯¯ç±»å‹è¯†åˆ«


**âš ï¸ é”™è¯¯æ¨¡å¼åˆ†ç±»**
```
ç³»ç»Ÿèµ„æºé”™è¯¯ï¼š
- "No space left on device" â†’ ç£ç›˜ç©ºé—´ä¸è¶³
- "Cannot allocate memory" â†’ å†…å­˜ä¸è¶³
- "Too many open files" â†’ æ–‡ä»¶æè¿°ç¬¦è€—å°½

æƒé™é”™è¯¯ï¼š
- "Permission denied" â†’ æƒé™ä¸è¶³
- "Operation not permitted" â†’ æ“ä½œä¸è¢«å…è®¸
- "Access denied" â†’ è®¿é—®è¢«æ‹’ç»

æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ï¼š
- "No such file or directory" â†’ æ–‡ä»¶ä¸å­˜åœ¨
- "Is a directory" â†’ æœŸæœ›æ–‡ä»¶ä½†æ˜¯ç›®å½•
- "Directory not empty" â†’ ç›®å½•éç©º

ç½‘ç»œé”™è¯¯ï¼š
- "Connection refused" â†’ è¿æ¥è¢«æ‹’ç»
- "Network unreachable" â†’ ç½‘ç»œä¸å¯è¾¾
- "Connection timed out" â†’ è¿æ¥è¶…æ—¶
```

### 7.2 é”™è¯¯ä¿¡æ¯æ”¶é›†è„šæœ¬


**ğŸ” è‡ªåŠ¨é”™è¯¯åˆ†æ**
```bash
#!/bin/bash
# error_collector.sh - é”™è¯¯ä¿¡æ¯æ”¶é›†åˆ†æ

LOG_FILE="/var/log/cron"
ERROR_REPORT="/tmp/cron_error_report.txt"
DATE_RANGE="$(date '+%b %d')"

echo "=== Croné”™è¯¯åˆ†ææŠ¥å‘Š ===" > "$ERROR_REPORT"
echo "ç”Ÿæˆæ—¶é—´: $(date)" >> "$ERROR_REPORT"
echo "" >> "$ERROR_REPORT"

# æ”¶é›†ä»Šæ—¥é”™è¯¯ä¿¡æ¯
echo "=== ä»Šæ—¥é”™è¯¯æ±‡æ€» ===" >> "$ERROR_REPORT"
grep "$DATE_RANGE" "$LOG_FILE" | grep -i "error\|fail\|denied\|cannot" >> "$ERROR_REPORT"

# æŒ‰é”™è¯¯ç±»å‹åˆ†ç±»
echo "" >> "$ERROR_REPORT"
echo "=== æƒé™é”™è¯¯ ===" >> "$ERROR_REPORT"
grep "$DATE_RANGE" "$LOG_FILE" | grep -i "permission\|denied\|access" >> "$ERROR_REPORT"

echo "" >> "$ERROR_REPORT"
echo "=== æ–‡ä»¶é”™è¯¯ ===" >> "$ERROR_REPORT"
grep "$DATE_RANGE" "$LOG_FILE" | grep -i "no such file\|directory" >> "$ERROR_REPORT"

echo "" >> "$ERROR_REPORT"
echo "=== èµ„æºé”™è¯¯ ===" >> "$ERROR_REPORT"
grep "$DATE_RANGE" "$LOG_FILE" | grep -i "space\|memory\|resource" >> "$ERROR_REPORT"

# å‘é€æŠ¥å‘Š
if [ -s "$ERROR_REPORT" ]; then
    mail -s "Cron Error Report - $(date '+%Y-%m-%d')" admin@example.com < "$ERROR_REPORT"
fi
```

### 7.3 é”™è¯¯é¢‘ç‡ç»Ÿè®¡


**ğŸ“Š é”™è¯¯è¶‹åŠ¿åˆ†æ**
```bash
#!/bin/bash
# error_frequency.sh - é”™è¯¯é¢‘ç‡ç»Ÿè®¡

LOG_FILE="/var/log/cron"
DAYS=${1:-7}  # é»˜è®¤åˆ†ææœ€è¿‘7å¤©

echo "=== æœ€è¿‘${DAYS}å¤©é”™è¯¯é¢‘ç‡ç»Ÿè®¡ ==="

# æŒ‰æ—¥æœŸç»Ÿè®¡é”™è¯¯æ•°é‡
for i in $(seq 0 $((DAYS-1))); do
    date_str=$(date -d "${i} days ago" '+%b %d')
    error_count=$(grep "$date_str" "$LOG_FILE" | grep -ci "error\|fail\|denied")
    echo "$(date -d "${i} days ago" '+%Y-%m-%d'): $error_count ä¸ªé”™è¯¯"
done

echo ""
echo "=== é”™è¯¯ç±»å‹æ’è¡Œ ==="
# ç»Ÿè®¡ä¸åŒç±»å‹é”™è¯¯çš„é¢‘ç‡
{
    grep -i "permission denied" "$LOG_FILE" | wc -l | xargs echo "æƒé™é”™è¯¯:"
    grep -i "no such file" "$LOG_FILE" | wc -l | xargs echo "æ–‡ä»¶ä¸å­˜åœ¨:"
    grep -i "space left" "$LOG_FILE" | wc -l | xargs echo "ç£ç›˜ç©ºé—´ä¸è¶³:"
    grep -i "memory" "$LOG_FILE" | wc -l | xargs echo "å†…å­˜é”™è¯¯:"
} | sort -nr -k2
```

### 7.4 æ™ºèƒ½é”™è¯¯åˆ†æ


**ğŸ¤– é”™è¯¯æ¨¡å¼è¯†åˆ«**
```bash
#!/bin/bash
# smart_error_analysis.sh - æ™ºèƒ½é”™è¯¯åˆ†æ

analyze_error_pattern() {
    local log_file="$1"
    local error_msg="$2"
    
    case "$error_msg" in
        *"Permission denied"*)
            echo "å»ºè®®: æ£€æŸ¥æ–‡ä»¶æƒé™ï¼Œå¯èƒ½éœ€è¦chmod/chown"
            echo "å‘½ä»¤: ls -la $(echo "$error_msg" | grep -o '/[^ ]*')"
            ;;
        *"No space left"*)
            echo "å»ºè®®: æ¸…ç†ç£ç›˜ç©ºé—´æˆ–æ‰©å±•åˆ†åŒº"
            echo "å‘½ä»¤: df -h && du -sh /* | sort -hr"
            ;;
        *"No such file"*)
            echo "å»ºè®®: æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®"
            echo "æ–‡ä»¶: $(echo "$error_msg" | grep -o '/[^ ]*')"
            ;;
        *"Connection refused"*)
            echo "å»ºè®®: æ£€æŸ¥ç½‘ç»œæœåŠ¡æ˜¯å¦è¿è¡Œ"
            echo "å‘½ä»¤: netstat -tlnp | grep $(echo "$error_msg" | grep -o '[0-9]*')"
            ;;
        *)
            echo "é€šç”¨å»ºè®®: æ£€æŸ¥ç³»ç»Ÿèµ„æºå’ŒæœåŠ¡çŠ¶æ€"
            ;;
    esac
}

# åˆ†ææœ€æ–°é”™è¯¯
latest_errors=$(tail -20 /var/log/cron | grep -i error)
if [ -n "$latest_errors" ]; then
    echo "$latest_errors" | while read -r error; do
        echo "é”™è¯¯: $error"
        analyze_error_pattern /var/log/cron "$error"
        echo "---"
    done
fi
```

---

## 8. â±ï¸ ä»»åŠ¡æ‰§è¡Œæ—¶é—´ç»Ÿè®¡


### 8.1 æ‰§è¡Œæ—¶é—´è®°å½•æ–¹æ³•


**ğŸ”¸ æ—¶é—´æµ‹é‡æŠ€æœ¯**
```bash
# æ–¹æ³•1ï¼šåœ¨è„šæœ¬ä¸­ä½¿ç”¨timeå‘½ä»¤
0 2 * * * /usr/bin/time -o /var/log/backup_time.log -a /opt/backup.sh

# æ–¹æ³•2ï¼šè„šæœ¬å†…éƒ¨æ—¶é—´è®¡ç®—
#!/bin/bash
# timed_task.sh - å¸¦æ—¶é—´ç»Ÿè®¡çš„ä»»åŠ¡è„šæœ¬

START_TIME=$(date +%s)
START_READABLE=$(date '+%Y-%m-%d %H:%M:%S')

echo "[$START_READABLE] Task started"

# æ‰§è¡Œå®é™…ä»»åŠ¡
/opt/backup.sh

# è®¡ç®—æ‰§è¡Œæ—¶é—´
END_TIME=$(date +%s)
END_READABLE=$(date '+%Y-%m-%d %H:%M:%S')
DURATION=$((END_TIME - START_TIME))

echo "[$END_READABLE] Task completed in ${DURATION} seconds"

# è®°å½•åˆ°æ—¶é—´ç»Ÿè®¡æ–‡ä»¶
echo "$(date '+%Y-%m-%d'),backup,$START_READABLE,$END_READABLE,$DURATION" >> /var/log/task_timing.csv
```

### 8.2 æ€§èƒ½æ•°æ®æ”¶é›†


**ğŸ“ˆ ç³»ç»Ÿèµ„æºä½¿ç”¨ç»Ÿè®¡**
```bash
#!/bin/bash
# resource_monitor.sh - èµ„æºä½¿ç”¨ç›‘æ§

TASK_NAME="$1"
shift
COMMAND="$@"

# åˆ›å»ºä¸´æ—¶æ–‡ä»¶è®°å½•èµ„æºä½¿ç”¨
TEMP_LOG="/tmp/resource_monitor_$$"

# å¼€å§‹ç›‘æ§
{
    echo "timestamp,cpu_percent,memory_mb,io_read,io_write"
    
    # åå°ç›‘æ§èµ„æºä½¿ç”¨
    while kill -0 $$ 2>/dev/null; do
        cpu_usage=$(top -bn1 -p $$ | awk 'NR>7{printf "%.1f", $9}')
        memory_mb=$(ps -o pid,vsz -p $$ | awk 'NR>1{print $2/1024}')
        io_stats=$(cat /proc/$$/io 2>/dev/null | grep -E "read_bytes|write_bytes" | awk '{sum+=$2} END {print sum/1024/1024}')
        
        echo "$(date '+%H:%M:%S'),$cpu_usage,$memory_mb,$io_stats"
        sleep 5
    done
} > "$TEMP_LOG" &

MONITOR_PID=$!

# æ‰§è¡Œä»»åŠ¡å¹¶è®¡æ—¶
START_TIME=$(date +%s)
$COMMAND
EXIT_CODE=$?
END_TIME=$(date +%s)

# åœæ­¢ç›‘æ§
kill $MONITOR_PID 2>/dev/null

# ç”ŸæˆæŠ¥å‘Š
DURATION=$((END_TIME - START_TIME))
echo "ä»»åŠ¡: $TASK_NAME"
echo "æ‰§è¡Œæ—¶é—´: ${DURATION}ç§’"
echo "é€€å‡ºä»£ç : $EXIT_CODE"
echo "èµ„æºä½¿ç”¨è¯¦æƒ…ä¿å­˜åœ¨: $TEMP_LOG"
```

### 8.3 æ€§èƒ½è¶‹åŠ¿åˆ†æ


**ğŸ“Š å†å²æ€§èƒ½æ•°æ®åˆ†æ**
```bash
#!/bin/bash
# performance_trend.sh - æ€§èƒ½è¶‹åŠ¿åˆ†æ

TIMING_LOG="/var/log/task_timing.csv"
TASK_NAME="$1"

if [ ! -f "$TIMING_LOG" ]; then
    echo "æ—¶é—´ç»Ÿè®¡æ–‡ä»¶ä¸å­˜åœ¨: $TIMING_LOG"
    exit 1
fi

echo "=== $TASK_NAME æ€§èƒ½è¶‹åŠ¿åˆ†æ ==="
echo

# æœ€è¿‘30å¤©çš„æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
echo "æœ€è¿‘30å¤©æ‰§è¡Œæ—¶é—´ç»Ÿè®¡:"
recent_data=$(grep "$TASK_NAME" "$TIMING_LOG" | tail -30)

if [ -n "$recent_data" ]; then
    # è®¡ç®—å¹³å‡æ‰§è¡Œæ—¶é—´
    avg_time=$(echo "$recent_data" | cut -d',' -f5 | awk '{sum+=$1; count++} END {printf "%.2f", sum/count}')
    
    # æœ€çŸ­å’Œæœ€é•¿æ‰§è¡Œæ—¶é—´
    min_time=$(echo "$recent_data" | cut -d',' -f5 | sort -n | head -1)
    max_time=$(echo "$recent_data" | cut -d',' -f5 | sort -nr | head -1)
    
    echo "å¹³å‡æ‰§è¡Œæ—¶é—´: ${avg_time}ç§’"
    echo "æœ€çŸ­æ‰§è¡Œæ—¶é—´: ${min_time}ç§’"
    echo "æœ€é•¿æ‰§è¡Œæ—¶é—´: ${max_time}ç§’"
    
    # æ€§èƒ½è­¦å‘Š
    if (( $(echo "$max_time > $avg_time * 2" | bc -l) )); then
        echo "âš ï¸  è­¦å‘Š: æ£€æµ‹åˆ°å¼‚å¸¸é•¿çš„æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®æ£€æŸ¥ç³»ç»Ÿæ€§èƒ½"
    fi
else
    echo "æ²¡æœ‰æ‰¾åˆ° $TASK_NAME çš„æ‰§è¡Œè®°å½•"
fi
```

### 8.4 å®šæ—¶ä»»åŠ¡æ€§èƒ½æŠ¥å‘Š


**ğŸ“‹ ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š**
```bash
#!/bin/bash
# generate_performance_report.sh - ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

REPORT_FILE="/tmp/cron_performance_report_$(date +%Y%m%d).html"

cat > "$REPORT_FILE" << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <title>å®šæ—¶ä»»åŠ¡æ€§èƒ½æŠ¥å‘Š</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .slow { background-color: #ffcccc; }
        .normal { background-color: #ccffcc; }
    </style>
</head>
<body>
    <h1>å®šæ—¶ä»»åŠ¡æ€§èƒ½æŠ¥å‘Š</h1>
    <p>ç”Ÿæˆæ—¶é—´: $(date)</p>
    
    <h2>ä»»åŠ¡æ‰§è¡Œæ—¶é—´ç»Ÿè®¡</h2>
    <table>
        <tr><th>ä»»åŠ¡åç§°</th><th>å¹³å‡æ—¶é—´(ç§’)</th><th>æœ€çŸ­æ—¶é—´</th><th>æœ€é•¿æ—¶é—´</th><th>æ‰§è¡Œæ¬¡æ•°</th><th>çŠ¶æ€</th></tr>
EOF

# åˆ†æå„ä¸ªä»»åŠ¡çš„æ€§èƒ½æ•°æ®
grep -o '^[^,]*,[^,]*' /var/log/task_timing.csv | sort | uniq | while IFS=',' read -r date task; do
    task_data=$(grep ",$task," /var/log/task_timing.csv | tail -30)
    
    if [ -n "$task_data" ]; then
        avg_time=$(echo "$task_data" | cut -d',' -f5 | awk '{sum+=$1; count++} END {printf "%.2f", sum/count}')
        min_time=$(echo "$task_data" | cut -d',' -f5 | sort -n | head -1)
        max_time=$(echo "$task_data" | cut -d',' -f5 | sort -nr | head -1)
        count=$(echo "$task_data" | wc -l)
        
        # åˆ¤æ–­æ€§èƒ½çŠ¶æ€
        if (( $(echo "$avg_time > 300" | bc -l) )); then
            status_class="slow"
            status="è¾ƒæ…¢"
        else
            status_class="normal" 
            status="æ­£å¸¸"
        fi
        
        echo "<tr class=\"$status_class\"><td>$task</td><td>$avg_time</td><td>$min_time</td><td>$max_time</td><td>$count</td><td>$status</td></tr>" >> "$REPORT_FILE"
    fi
done

cat >> "$REPORT_FILE" << 'EOF'
    </table>
</body>
</html>
EOF

echo "æ€§èƒ½æŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE"

# å‘é€æŠ¥å‘Šï¼ˆå¦‚æœé…ç½®äº†é‚®ä»¶ï¼‰
if command -v mail >/dev/null 2>&1; then
    mail -s "å®šæ—¶ä»»åŠ¡æ€§èƒ½æŠ¥å‘Š - $(date '+%Y-%m-%d')" -a "Content-Type: text/html" admin@example.com < "$REPORT_FILE"
fi
```

---

## 9. ğŸš¨ å¼‚å¸¸ä»»åŠ¡å‘Šè­¦æœºåˆ¶


### 9.1 å‘Šè­¦ç­–ç•¥è®¾è®¡


**ğŸ”¸ å‘Šè­¦çº§åˆ«åˆ†ç±»**
```
å‘Šè­¦çº§åˆ«å®šä¹‰ï¼š

ğŸ”´ Critical (ä¸¥é‡)ï¼š
- æ ¸å¿ƒä¸šåŠ¡ä»»åŠ¡å¤±è´¥
- æ•°æ®å¤‡ä»½ä»»åŠ¡å¤±è´¥
- å®‰å…¨ç›¸å…³ä»»åŠ¡å¼‚å¸¸

ğŸŸ  Warning (è­¦å‘Š)ï¼š
- ä»»åŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é¢„æœŸ
- ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡è¿‡é«˜
- ä»»åŠ¡è¾“å‡ºåŒ…å«è­¦å‘Šä¿¡æ¯

ğŸŸ¡ Info (ä¿¡æ¯)ï¼š
- ä»»åŠ¡æ­£å¸¸å®Œæˆä½†æœ‰æ³¨æ„äº‹é¡¹
- æ€§èƒ½æŒ‡æ ‡è½»å¾®å¼‚å¸¸
- é…ç½®å˜æ›´æé†’

å‘Šè­¦è§¦å‘æ¡ä»¶ï¼š
- ä»»åŠ¡è¿ç»­å¤±è´¥æ¬¡æ•°
- æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼å€æ•°
- èµ„æºä½¿ç”¨é‡è¶…è¿‡é™åˆ¶
```

### 9.2 å®æ—¶ç›‘æ§è„šæœ¬


**âš¡ ä»»åŠ¡çŠ¶æ€å®æ—¶ç›‘æ§**
```bash
#!/bin/bash
# real_time_monitor.sh - å®æ—¶ä»»åŠ¡ç›‘æ§

CONFIG_FILE="/etc/cron_monitor.conf"
LOCK_FILE="/var/lock/cron_monitor.lock"

# æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨è¿è¡Œ
if [ -f "$LOCK_FILE" ]; then
    if kill -0 $(cat "$LOCK_FILE") 2>/dev/null; then
        echo "ç›‘æ§ç¨‹åºå·²åœ¨è¿è¡Œ"
        exit 1
    else
        rm -f "$LOCK_FILE"
    fi
fi

# åˆ›å»ºé”æ–‡ä»¶
echo $$ > "$LOCK_FILE"

# æ¸…ç†å‡½æ•°
cleanup() {
    rm -f "$LOCK_FILE"
    exit 0
}

trap cleanup SIGTERM SIGINT

# è¯»å–ç›‘æ§é…ç½®
load_config() {
    if [ -f "$CONFIG_FILE" ]; then
        source "$CONFIG_FILE"
    else
        # é»˜è®¤é…ç½®
        CRITICAL_TASKS="backup,database_dump"
        MAX_FAILURE_COUNT=3
        MAX_EXECUTION_TIME=3600
        ALERT_EMAIL="admin@example.com"
    fi
}

# å‘é€å‘Šè­¦
send_alert() {
    local level="$1"
    local task="$2"  
    local message="$3"
    
    case "$level" in
        "CRITICAL")
            subject="ğŸ”´ CRITICAL: $task"
            ;;
        "WARNING") 
            subject="ğŸŸ  WARNING: $task"
            ;;
        "INFO")
            subject="ğŸŸ¡ INFO: $task"
            ;;
    esac
    
    echo "$message" | mail -s "$subject" "$ALERT_EMAIL"
    
    # åŒæ—¶è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—
    logger -p cron.alert "$level: $task - $message"
}

# æ£€æŸ¥ä»»åŠ¡å¤±è´¥æ¬¡æ•°
check_failure_count() {
    local task="$1"
    local failures=$(grep -c "FAILED.*$task" /var/log/task_status.log | tail -${MAX_FAILURE_COUNT})
    
    if [ "$failures" -ge "$MAX_FAILURE_COUNT" ]; then
        send_alert "CRITICAL" "$task" "ä»»åŠ¡è¿ç»­å¤±è´¥${failures}æ¬¡ï¼Œéœ€è¦ç«‹å³æ£€æŸ¥"
        return 1
    fi
    return 0
}

# ä¸»ç›‘æ§å¾ªç¯
load_config

while true; do
    # ç›‘æ§å„ä¸ªå…³é”®ä»»åŠ¡
    IFS=',' read -ra TASKS <<< "$CRITICAL_TASKS"
    for task in "${TASKS[@]}"; do
        check_failure_count "$task"
    done
    
    # æ£€æŸ¥ç³»ç»Ÿèµ„æº
    disk_usage=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
    if [ "$disk_usage" -gt 90 ]; then
        send_alert "WARNING" "disk_space" "æ ¹åˆ†åŒºä½¿ç”¨ç‡è¾¾åˆ°${disk_usage}%"
    fi
    
    # æ£€æŸ¥å†…å­˜ä½¿ç”¨
    memory_usage=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
    if [ "$memory_usage" -gt 90 ]; then
        send_alert "WARNING" "memory_usage" "å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°${memory_usage}%"
    fi
    
    sleep 300  # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
done
```

### 9.3 åŸºäºæ—¶é—´çª—å£çš„å‘Šè­¦


**â° æ™ºèƒ½æ—¶é—´çª—å£ç›‘æ§**
```bash
#!/bin/bash
# time_window_alert.sh - åŸºäºæ—¶é—´çª—å£çš„å‘Šè­¦

# é…ç½®å‚æ•°
TIME_WINDOW=30  # åˆ†é’Ÿ
FAILURE_THRESHOLD=3
LOG_FILE="/var/log/task_status.log"

check_time_window() {
    local task_name="$1"
    local current_time=$(date +%s)
    local window_start=$((current_time - TIME_WINDOW * 60))
    
    # ç»Ÿè®¡æ—¶é—´çª—å£å†…çš„å¤±è´¥æ¬¡æ•°
    failures=0
    while read -r line; do
        # æå–æ—¶é—´æˆ³
        timestamp=$(echo "$line" | grep -o '[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\} [0-9]\{2\}:[0-9]\{2\}:[0-9]\{2\}')
        if [ -n "$timestamp" ]; then
            line_time=$(date -d "$timestamp" +%s)
            
            # æ£€æŸ¥æ˜¯å¦åœ¨æ—¶é—´çª—å£å†…
            if [ "$line_time" -ge "$window_start" ] && echo "$line" | grep -q "FAILED.*$task_name"; then
                ((failures++))
            fi
        fi
    done < "$LOG_FILE"
    
    # åˆ¤æ–­æ˜¯å¦éœ€è¦å‘Šè­¦
    if [ "$failures" -ge "$FAILURE_THRESHOLD" ]; then
        echo "å‘Šè­¦: ä»»åŠ¡ $task_name åœ¨è¿‡å» $TIME_WINDOW åˆ†é’Ÿå†…å¤±è´¥ $failures æ¬¡"
        return 1
    fi
    
    return 0
}

# æ£€æŸ¥æ‰€æœ‰ä»»åŠ¡
for task in $(grep -o 'Task [^:]*' "$LOG_FILE" | cut -d' ' -f2 | sort | uniq); do
    check_time_window "$task"
done
```

### 9.4 å¤šæ¸ é“å‘Šè­¦é€šçŸ¥


**ğŸ“± å¤šç§é€šçŸ¥æ–¹å¼é›†æˆ**
```bash
#!/bin/bash
# multi_channel_alert.sh - å¤šæ¸ é“å‘Šè­¦é€šçŸ¥

WEBHOOK_URL="https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
TELEGRAM_BOT_TOKEN="YOUR_BOT_TOKEN"
TELEGRAM_CHAT_ID="YOUR_CHAT_ID"

send_email_alert() {
    local subject="$1"
    local message="$2"
    echo "$message" | mail -s "$subject" admin@example.com
}

send_slack_alert() {
    local message="$1"
    
    curl -X POST -H 'Content-type: application/json' \
         --data "{\"text\":\"$message\"}" \
         "$WEBHOOK_URL"
}

send_telegram_alert() {
    local message="$1"
    
    curl -s -X POST \
         "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
         -d chat_id="$TELEGRAM_CHAT_ID" \
         -d text="$message"
}

send_sms_alert() {
    local message="$1"
    # ä½¿ç”¨çŸ­ä¿¡æœåŠ¡APIå‘é€çŸ­ä¿¡
    # è¿™é‡Œéœ€è¦æ ¹æ®å…·ä½“çš„çŸ­ä¿¡æœåŠ¡æä¾›å•†æ¥å®ç°
    echo "å‘é€çŸ­ä¿¡: $message"
}

# ç»Ÿä¸€å‘Šè­¦æ¥å£
send_alert() {
    local level="$1"
    local task="$2"
    local message="$3"
    
    case "$level" in
        "CRITICAL")
            send_email_alert "ğŸ”´ CRITICAL: $task" "$message"
            send_slack_alert "ğŸ”´ CRITICAL: $task - $message"
            send_telegram_alert "ğŸ”´ CRITICAL: $task - $message"
            send_sms_alert "CRITICAL: $task å‡ºç°ä¸¥é‡é—®é¢˜"
            ;;
        "WARNING")
            send_email_alert "ğŸŸ  WARNING: $task" "$message"
            send_slack_alert "ğŸŸ  WARNING: $task - $message"
            ;;
        "INFO")
            send_email_alert "ğŸŸ¡ INFO: $task" "$message"
            ;;
    esac
}

# ä½¿ç”¨ç¤ºä¾‹
send_alert "CRITICAL" "database_backup" "æ•°æ®åº“å¤‡ä»½è¿ç»­å¤±è´¥3æ¬¡ï¼Œéœ€è¦ç«‹å³å¤„ç†"
```

---

## 10. ğŸ§¹ æ—¥å¿—ç»´æŠ¤ä¸ä¼˜åŒ–


### 10.1 æ—¥å¿—æ–‡ä»¶æ¸…ç†ç­–ç•¥


**ğŸ”¸ è‡ªåŠ¨åŒ–æ—¥å¿—æ¸…ç†**
```bash
#!/bin/bash
# log_cleanup.sh - æ—¥å¿—æ–‡ä»¶æ¸…ç†è„šæœ¬

LOG_DIRS="/var/log /opt/logs /tmp"
RETENTION_DAYS=30
DRY_RUN=false

usage() {
    echo "ç”¨æ³•: $0 [-d days] [-n] [-h]"
    echo "  -d days  ä¿ç•™å¤©æ•° (é»˜è®¤: 30)"
    echo "  -n       è¯•è¿è¡Œæ¨¡å¼"
    echo "  -h       æ˜¾ç¤ºå¸®åŠ©"
}

while getopts "d:nh" opt; do
    case $opt in
        d) RETENTION_DAYS="$OPTARG" ;;
        n) DRY_RUN=true ;;
        h) usage; exit 0 ;;
        *) usage; exit 1 ;;
    esac
done

cleanup_logs() {
    local log_dir="$1"
    
    echo "æ¸…ç†ç›®å½•: $log_dir"
    
    # æŸ¥æ‰¾å¹¶æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
    find "$log_dir" -name "*.log" -type f -mtime +$RETENTION_DAYS -print0 | while IFS= read -r -d '' file; do
        size=$(du -h "$file" | cut -f1)
        if [ "$DRY_RUN" = true ]; then
            echo "  [è¯•è¿è¡Œ] å°†åˆ é™¤: $file ($size)"
        else
            echo "  åˆ é™¤: $file ($size)"
            rm -f "$file"
        fi
    done
    
    # æ¸…ç†å‹ç¼©çš„æ—¥å¿—æ–‡ä»¶
    find "$log_dir" -name "*.log.gz" -type f -mtime +$RETENTION_DAYS -print0 | while IFS= read -r -d '' file; do
        size=$(du -h "$file" | cut -f1)
        if [ "$DRY_RUN" = true ]; then
            echo "  [è¯•è¿è¡Œ] å°†åˆ é™¤: $file ($size)"
        else
            echo "  åˆ é™¤: $file ($size)"
            rm -f "$file"
        fi
    done
}

# æ‰§è¡Œæ¸…ç†
for dir in $LOG_DIRS; do
    if [ -d "$dir" ]; then
        cleanup_logs "$dir"
    fi
done

# æ¸…ç†ç©ºç›®å½•
if [ "$DRY_RUN" = false ]; then
    find $LOG_DIRS -type d -empty -delete 2>/dev/null
fi

echo "æ—¥å¿—æ¸…ç†å®Œæˆ"
```

### 10.2 æ—¥å¿—å‹ç¼©å½’æ¡£


**ğŸ“¦ é«˜æ•ˆæ—¥å¿—å‹ç¼©æ–¹æ¡ˆ**
```bash
#!/bin/bash
# log_compression.sh - æ—¥å¿—å‹ç¼©å½’æ¡£

COMPRESS_AGE=7  # 7å¤©å‰çš„æ—¥å¿—è¿›è¡Œå‹ç¼©
ARCHIVE_DIR="/var/log/archive"

# åˆ›å»ºå½’æ¡£ç›®å½•
mkdir -p "$ARCHIVE_DIR"

compress_old_logs() {
    local log_pattern="$1"
    local log_name="$2"
    
    # æŸ¥æ‰¾éœ€è¦å‹ç¼©çš„æ—¥å¿—æ–‡ä»¶
    find /var/log -name "$log_pattern" -type f -mtime +$COMPRESS_AGE ! -name "*.gz" | while read -r logfile; do
        echo "å‹ç¼©æ—¥å¿—: $logfile"
        
        # è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´ä½œä¸ºå½’æ¡£åç§°çš„ä¸€éƒ¨åˆ†
        file_date=$(date -r "$logfile" '+%Y%m%d')
        compressed_name="${log_name}_${file_date}.log.gz"
        
        # å‹ç¼©å¹¶ç§»åŠ¨åˆ°å½’æ¡£ç›®å½•
        gzip -c "$logfile" > "$ARCHIVE_DIR/$compressed_name"
        
        if [ $? -eq 0 ]; then
            rm "$logfile"
            echo "å·²å‹ç¼©å¹¶å½’æ¡£: $compressed_name"
        else
            echo "å‹ç¼©å¤±è´¥: $logfile"
        fi
    done
}

# å‹ç¼©å„ç§ç±»å‹çš„æ—¥å¿—
compress_old_logs "backup*.log" "backup"
compress_old_logs "cleanup*.log" "cleanup"
compress_old_logs "task_status*.log" "task_status"

# ç”Ÿæˆå½’æ¡£æŠ¥å‘Š
echo "=== æ—¥å¿—å½’æ¡£æŠ¥å‘Š ===" > /tmp/archive_report.txt
echo "å½’æ¡£æ—¶é—´: $(date)" >> /tmp/archive_report.txt
echo "å½’æ¡£æ–‡ä»¶åˆ—è¡¨:" >> /tmp/archive_report.txt
ls -lh "$ARCHIVE_DIR" >> /tmp/archive_report.txt
```

### 10.3 æ—¥å¿—æ€§èƒ½ä¼˜åŒ–


**âš¡ æå‡æ—¥å¿—å†™å…¥æ€§èƒ½**
```bash
# ä¼˜åŒ–æ—¥å¿—å†™å…¥æ€§èƒ½çš„å»ºè®®é…ç½®

# 1. ä½¿ç”¨å¼‚æ­¥æ—¥å¿—å†™å…¥
# åœ¨è„šæœ¬ä¸­ä½¿ç”¨åå°è¿›ç¨‹å†™æ—¥å¿—
log_async() {
    local message="$1"
    local logfile="$2"
    
    # åå°å¼‚æ­¥å†™å…¥ï¼Œé¿å…é˜»å¡ä¸»è¿›ç¨‹
    {
        echo "$(date '+%Y-%m-%d %H:%M:%S') $message" >> "$logfile"
    } &
}

# 2. æ‰¹é‡æ—¥å¿—å†™å…¥
LOG_BUFFER=""
LOG_BUFFER_SIZE=0
MAX_BUFFER_SIZE=100

add_to_buffer() {
    local message="$1"
    LOG_BUFFER="$LOG_BUFFER$(date '+%Y-%m-%d %H:%M:%S') $message\n"
    ((LOG_BUFFER_SIZE++))
    
    if [ $LOG_BUFFER_SIZE -ge $MAX_BUFFER_SIZE ]; then
        flush_buffer
    fi
}

flush_buffer() {
    if [ $LOG_BUFFER_SIZE -gt 0 ]; then
        echo -e "$LOG_BUFFER" >> /var/log/batch.log
        LOG_BUFFER=""
        LOG_BUFFER_SIZE=0
    fi
}

# 3. å†…å­˜æ—¥å¿—ç¼“å­˜
setup_memory_log() {
    # åˆ›å»ºå†…å­˜æ–‡ä»¶ç³»ç»Ÿç”¨äºä¸´æ—¶æ—¥å¿—
    sudo mkdir -p /var/log/memory
    sudo mount -t tmpfs -o size=100M tmpfs /var/log/memory
    
    # å®šæœŸåŒæ­¥åˆ°ç£ç›˜
    (
        while true; do
            sleep 300  # æ¯5åˆ†é’ŸåŒæ­¥ä¸€æ¬¡
            rsync -a /var/log/memory/ /var/log/persistent/
        done
    ) &
}
```

### 10.4 æ—¥å¿—åˆ†æå·¥å…·é›†æˆ


**ğŸ”§ é›†æˆç°ä»£åŒ–æ—¥å¿—åˆ†æå·¥å…·**
```bash
#!/bin/bash
# setup_log_analysis.sh - è®¾ç½®æ—¥å¿—åˆ†æå·¥å…·

# 1. é…ç½®ELK Stacké›†æˆ
setup_filebeat() {
    cat > /etc/filebeat/filebeat.yml << 'EOF'
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/cron
    - /var/log/task_status.log
    - /var/log/backup*.log
  fields:
    service: cron_tasks
  fields_under_root: true

output.elasticsearch:
  hosts: ["localhost:9200"]
  
processors:
- add_host_metadata:
    when.not.contains.tags: forwarded
EOF
    
    systemctl enable filebeat
    systemctl start filebeat
}

# 2. é…ç½®Grafanaç›‘æ§é¢æ¿
create_grafana_dashboard() {
    cat > /tmp/cron_dashboard.json << 'EOF'
{
  "dashboard": {
    "id": null,
    "title": "Cronä»»åŠ¡ç›‘æ§",
    "panels": [
      {
        "title": "ä»»åŠ¡æ‰§è¡ŒæˆåŠŸç‡",
        "type": "stat",
        "targets": [
          {
            "expr": "sum(rate(cron_success_total[5m])) / sum(rate(cron_total[5m])) * 100"
          }
        ]
      },
      {
        "title": "ä»»åŠ¡æ‰§è¡Œæ—¶é—´",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, cron_duration_seconds_bucket)"
          }
        ]
      }
    ]
  }
}
EOF
    
    # å¯¼å…¥åˆ°Grafana
    curl -X POST \
         -H "Content-Type: application/json" \
         -d @/tmp/cron_dashboard.json \
         http://admin:admin@localhost:3000/api/dashboards/db
}

# 3. è®¾ç½®PrometheusæŒ‡æ ‡æ”¶é›†
setup_prometheus_metrics() {
    cat > /opt/cron_exporter.py << 'EOF'
#!/usr/bin/env python3
import re
import time
from prometheus_client import start_http_server, Counter, Histogram, Gauge

# å®šä¹‰æŒ‡æ ‡
cron_total = Counter('cron_jobs_total', 'Total cron jobs executed', ['job', 'user'])
cron_success = Counter('cron_jobs_success_total', 'Successful cron jobs', ['job', 'user'])
cron_duration = Histogram('cron_job_duration_seconds', 'Duration of cron jobs', ['job', 'user'])

def parse_cron_log():
    with open('/var/log/cron', 'r') as f:
        for line in f:
            # è§£æcronæ—¥å¿—æ ¼å¼
            match = re.search(r'CRON\[(\d+)\]: \((\w+)\) CMD \((.+)\)', line)
            if match:
                user = match.group(2)
                command = match.group(3)
                cron_total.labels(job=command, user=user).inc()

if __name__ == '__main__':
    start_http_server(8000)
    while True:
        parse_cron_log()
        time.sleep(60)
EOF
    
    chmod +x /opt/cron_exporter.py
    
    # åˆ›å»ºsystemdæœåŠ¡
    cat > /etc/systemd/system/cron-exporter.service << 'EOF'
[Unit]
Description=Cron Prometheus Exporter
After=network.target

[Service]
Type=simple
ExecStart=/opt/cron_exporter.py
Restart=always

[Install]
WantedBy=multi-user.target
EOF
    
    systemctl enable cron-exporter.service
    systemctl start cron-exporter.service
}

echo "é€‰æ‹©è¦å®‰è£…çš„å·¥å…·:"
echo "1) Filebeat (ELK Stack)"
echo "2) Grafana Dashboard"  
echo "3) Prometheus Exporter"
echo "4) å…¨éƒ¨å®‰è£…"

read -p "è¯·é€‰æ‹© (1-4): " choice

case $choice in
    1) setup_filebeat ;;
    2) create_grafana_dashboard ;;
    3) setup_prometheus_metrics ;;
    4) setup_filebeat; create_grafana_dashboard; setup_prometheus_metrics ;;
    *) echo "æ— æ•ˆé€‰æ‹©" ;;
esac
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ æ—¥å¿—ç³»ç»Ÿåˆ†å±‚ï¼šç³»ç»Ÿæ—¥å¿—ã€åº”ç”¨æ—¥å¿—ã€é€šçŸ¥ç³»ç»Ÿä¸‰å±‚æ¶æ„
ğŸ”¸ æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š/var/log/cronã€journalctlã€è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶
ğŸ”¸ é‡å®šå‘æŠ€æœ¯ï¼šstdoutã€stderråˆ†ç¦»ï¼Œæ—¶é—´æˆ³æ·»åŠ ï¼Œåˆ†ç±»è®°å½•
ğŸ”¸ ç›‘æ§ç­–ç•¥ï¼šå®æ—¶ç›‘æ§ã€å¼‚å¸¸å‘Šè­¦ã€æ€§èƒ½ç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æ
ğŸ”¸ ç»´æŠ¤ä¼˜åŒ–ï¼šæ—¥å¿—æ¸…ç†ã€å‹ç¼©å½’æ¡£ã€æ€§èƒ½ä¼˜åŒ–ã€å·¥å…·é›†æˆ
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ—¥å¿—ç›‘æ§çš„ä»·å€¼é“¾**
```
æ•°æ®æ”¶é›† â†’ å®æ—¶ç›‘æ§ â†’ å¼‚å¸¸æ£€æµ‹ â†’ æ™ºèƒ½å‘Šè­¦ â†’ é—®é¢˜è§£å†³

ä»·å€¼ä½“ç°ï¼š
- æ•…éšœé¢„é˜²ï¼šæå‰å‘ç°æ½œåœ¨é—®é¢˜
- å¿«é€Ÿå“åº”ï¼šå¼‚å¸¸æƒ…å†µç«‹å³å‘Šè­¦
- æ€§èƒ½ä¼˜åŒ–ï¼šåŸºäºæ•°æ®æ”¹è¿›ä»»åŠ¡æ•ˆç‡
- åˆè§„å®¡è®¡ï¼šå®Œæ•´çš„æ“ä½œè®°å½•è¿½æº¯
```

**ğŸ”¹ ç›‘æ§ç­–ç•¥çš„æ ¸å¿ƒåŸåˆ™**
```
åˆ†çº§å‘Šè­¦ï¼š
âœ… ä¸¥é‡é—®é¢˜ç«‹å³é€šçŸ¥
âœ… ä¸€èˆ¬é—®é¢˜å®šæ—¶æ±‡æ€»
âœ… ä¿¡æ¯ç±»åˆ«ä»…è®°å½•æ—¥å¿—

æ™ºèƒ½è¿‡æ»¤ï¼š
âœ… é¿å…å‘Šè­¦é£æš´
âœ… è¯†åˆ«é‡å¤é—®é¢˜
âœ… åŸºäºæ¨¡å¼åˆ†æ
```

**ğŸ”¹ æ—¥å¿—ç®¡ç†æœ€ä½³å®è·µ**
```
ç»“æ„åŒ–æ—¥å¿—ï¼š
- ç»Ÿä¸€æ—¶é—´æˆ³æ ¼å¼
- æ ‡å‡†åŒ–å­—æ®µå®šä¹‰
- ä¾¿äºè‡ªåŠ¨åŒ–åˆ†æ

åˆç†è½®è½¬ï¼š
- æŒ‰å¤§å°å’Œæ—¶é—´åŒé‡æ¡ä»¶
- å‹ç¼©å†å²æ—¥å¿—èŠ‚çœç©ºé—´
- ä¿ç•™è¶³å¤Ÿçš„å†å²è®°å½•

æ€§èƒ½è€ƒè™‘ï¼š
- å¼‚æ­¥å†™å…¥é¿å…é˜»å¡
- æ‰¹é‡æ“ä½œæå‡æ•ˆç‡
- å†…å­˜ç¼“å­˜å‡å°‘IO
```

### 11.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ ä¸åŒåœºæ™¯çš„ç›‘æ§ç­–ç•¥**
```
ç”Ÿäº§ç¯å¢ƒï¼š
ğŸ¯ ä¸¥æ ¼çš„å‘Šè­¦æœºåˆ¶
ğŸ¯ å¤šæ¸ é“é€šçŸ¥ç¡®ä¿åŠæ—¶æ€§
ğŸ¯ è¯¦ç»†çš„æ€§èƒ½æ•°æ®æ”¶é›†
ğŸ¯ è‡ªåŠ¨åŒ–é—®é¢˜è¯Šæ–­å’Œæ¢å¤

å¼€å‘ç¯å¢ƒï¼š
ğŸ¯ è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
ğŸ¯ å®½æ¾çš„å‘Šè­¦ç­–ç•¥
ğŸ¯ ä¾¿äºå¼€å‘è€…çš„æ—¥å¿—æ ¼å¼

æµ‹è¯•ç¯å¢ƒï¼š
ğŸ¯ å®Œæ•´çš„æ‰§è¡Œè®°å½•
ğŸ¯ æ€§èƒ½åŸºå‡†æ•°æ®æ”¶é›†
ğŸ¯ é”™è¯¯å¤ç°ä¿¡æ¯ä¿ç•™
```

**âš ï¸ å¸¸è§é™·é˜±å’Œé¿å…æ–¹æ³•**
```
æ—¥å¿—çˆ†ç‚¸ï¼š
âŒ è¿‡åº¦è¯¦ç»†çš„æ—¥å¿—è®°å½•
âœ… åˆ†çº§è®°å½•ï¼Œé‡è¦ä¿¡æ¯ä¼˜å…ˆ

å‘Šè­¦ç–²åŠ³ï¼š
âŒ è¿‡äºæ•æ„Ÿçš„å‘Šè­¦é˜ˆå€¼
âœ… æ™ºèƒ½èšåˆï¼Œå‡å°‘å™ªéŸ³

æ€§èƒ½å½±å“ï¼š
âŒ åŒæ­¥æ—¥å¿—å†™å…¥é˜»å¡ä»»åŠ¡
âœ… å¼‚æ­¥å¤„ç†ï¼Œæ‰¹é‡æ“ä½œ

å­˜å‚¨æµªè´¹ï¼š
âŒ æ— é™åˆ¶çš„æ—¥å¿—ä¿ç•™
âœ… åˆç†è½®è½¬ï¼Œå‹ç¼©å½’æ¡£
```

### 11.4 è¿ç»´æˆç†Ÿåº¦æå‡è·¯å¾„


**ğŸ“ˆ ä»åŸºç¡€åˆ°é«˜çº§çš„æ¼”è¿›**
```
Level 1 - åŸºç¡€ç›‘æ§ï¼š
â–¡ é…ç½®åŸºæœ¬æ—¥å¿—è®°å½•
â–¡ è®¾ç½®ç®€å•é‚®ä»¶é€šçŸ¥
â–¡ æ‰‹åŠ¨æ£€æŸ¥ä»»åŠ¡çŠ¶æ€

Level 2 - è‡ªåŠ¨åŒ–ç›‘æ§ï¼š
â–¡ å®ç°è‡ªåŠ¨å¼‚å¸¸æ£€æµ‹
â–¡ å¤šæ¸ é“å‘Šè­¦é€šçŸ¥
â–¡ å®šæœŸæ€§èƒ½æŠ¥å‘Šç”Ÿæˆ

Level 3 - æ™ºèƒ½è¿ç»´ï¼š
â–¡ åŸºäºæœºå™¨å­¦ä¹ çš„å¼‚å¸¸æ£€æµ‹
â–¡ é¢„æµ‹æ€§ç»´æŠ¤
â–¡ è‡ªåŠ¨åŒ–é—®é¢˜ä¿®å¤

Level 4 - è¿ç»´å¯è§‚æµ‹æ€§ï¼š
â–¡ å…¨é“¾è·¯è¿½è¸ª
â–¡ å®æ—¶æ€§èƒ½ç›‘æ§
â–¡ ä¸šåŠ¡æŒ‡æ ‡å…³è”åˆ†æ
```

### 11.5 æ•…éšœæ’æŸ¥æ£€æŸ¥æ¸…å•


**ğŸ”§ ç³»ç»Ÿæ€§æ•…éšœè¯Šæ–­æµç¨‹**
```
å½“å®šæ—¶ä»»åŠ¡å‡ºç°é—®é¢˜æ—¶çš„æ’æŸ¥æ­¥éª¤ï¼š

1. åŸºç¡€æ£€æŸ¥ï¼š
   â–¡ æ£€æŸ¥cronæœåŠ¡æ˜¯å¦è¿è¡Œ
   â–¡ éªŒè¯crontabè¯­æ³•æ˜¯å¦æ­£ç¡®
   â–¡ ç¡®è®¤ç”¨æˆ·æƒé™æ˜¯å¦è¶³å¤Ÿ

2. æ—¥å¿—åˆ†æï¼š
   â–¡ æŸ¥çœ‹/var/log/cronä¸­çš„æ‰§è¡Œè®°å½•
   â–¡ åˆ†æä»»åŠ¡è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯
   â–¡ æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

3. ç¯å¢ƒéªŒè¯ï¼š
   â–¡ ç¡®è®¤è„šæœ¬è·¯å¾„å’Œæƒé™
   â–¡ éªŒè¯ç¯å¢ƒå˜é‡è®¾ç½®
   â–¡ æµ‹è¯•ç½‘ç»œå’Œå¤–éƒ¨ä¾èµ–

4. æ€§èƒ½åˆ†æï¼š
   â–¡ å¯¹æ¯”å†å²æ‰§è¡Œæ—¶é—´
   â–¡ æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½æƒ…å†µ
   â–¡ åˆ†æèµ„æºç“¶é¢ˆ

5. ä¿®å¤éªŒè¯ï¼š
   â–¡ å®æ–½ä¿®å¤æªæ–½
   â–¡ ç›‘æ§åç»­æ‰§è¡Œæƒ…å†µ
   â–¡ æ›´æ–°ç›‘æ§ç­–ç•¥
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æ—¥å¿—æ˜¯å®šæ—¶ä»»åŠ¡è¿ç»´çš„ç”Ÿå‘½çº¿ï¼Œå¿…é¡»åšå¥½åˆ†ç±»è®°å½•å’Œå®æ—¶ç›‘æ§
- å‘Šè­¦æœºåˆ¶è¦åˆ†çº§è®¾è®¡ï¼Œé¿å…å‘Šè­¦ç–²åŠ³åŒæ—¶ç¡®ä¿é‡è¦é—®é¢˜åŠæ—¶å“åº”
- æ€§èƒ½æ•°æ®æ”¶é›†ä¸ºä¼˜åŒ–æä¾›ä¾æ®ï¼Œè¶‹åŠ¿åˆ†æå¸®åŠ©é¢„é˜²é—®é¢˜
- æ—¥å¿—ç»´æŠ¤å’Œä¼˜åŒ–æ˜¯é•¿æœŸå·¥ç¨‹ï¼Œéœ€è¦å¹³è¡¡è¯¦ç»†ç¨‹åº¦å’Œç³»ç»Ÿæ€§èƒ½
- ç°ä»£åŒ–å·¥å…·é›†æˆèƒ½å¤§å¹…æå‡è¿ç»´æ•ˆç‡å’Œé—®é¢˜å‘ç°èƒ½åŠ›