---
title: 3、cron时间表达式语法
---
## 📚 目录

1. [cron时间表达式基础概念](#1-cron时间表达式基础概念)
2. [五字段时间格式详解](#2-五字段时间格式详解)
3. [特殊字符与通配符使用](#3-特殊字符与通配符使用)
4. [时间表达式组合规则](#4-时间表达式组合规则)
5. [特殊时间关键字](#5-特殊时间关键字)
6. [常见时间模式示例](#6-常见时间模式示例)
7. [核心要点总结](#7-核心要点总结)

---

## 1. ⏰ cron时间表达式基础概念


### 1.1 什么是cron时间表达式


**简单理解**：cron时间表达式就像设定闹钟一样，告诉系统什么时候执行任务。

```
生活中的闹钟：每天早上7点叫我起床
cron表达式：  0 7 * * *  /path/to/script.sh

生活中的提醒：每周一上午9点开例会  
cron表达式：  0 9 * * 1  /usr/bin/meeting-reminder
```

> 📌 **核心概念**  
> cron时间表达式是一种用于定义任务执行时间的标准格式，通过5个字段精确控制任务的运行时机。

### 1.2 为什么需要时间表达式


**解决的问题**：
- **自动化任务**：无需人工干预的定时执行
- **精确控制**：可以设定复杂的时间规则
- **资源优化**：在系统空闲时执行任务
- **业务需求**：满足各种定时业务场景

```
实际应用场景：
数据备份    → 每天凌晨2点自动备份
日志清理    → 每周日凌晨删除旧日志
系统监控    → 每5分钟检查系统状态
报表生成    → 每月1号生成月度报表
```

---

## 2. 📋 五字段时间格式详解


### 2.1 标准五字段格式


cron时间表达式由**5个字段**组成，用空格分隔：

```
* * * * *  command
│ │ │ │ │
│ │ │ │ └─── 星期 (0-7, 0和7都表示周日)
│ │ │ └───── 月份 (1-12)
│ │ └─────── 日期 (1-31)  
│ └───────── 小时 (0-23)
└─────────── 分钟 (0-59)
```

### 2.2 各字段取值范围


| 字段 | **取值范围** | **说明** | **示例** |
|------|-------------|----------|----------|
| 🕐 分钟 | `0-59` | 每小时的第几分钟 | `30` = 第30分钟 |
| 🕑 小时 | `0-23` | 24小时制，0表示午夜 | `14` = 下午2点 |
| 📅 日期 | `1-31` | 每月的第几天 | `15` = 每月15号 |
| 📆 月份 | `1-12` | 一年中的第几个月 | `3` = 3月份 |
| 📝 星期 | `0-7` | 周日到周六，0和7都是周日 | `1` = 周一 |

> ⚠️ **注意事项**  
> - 小时采用24小时制，0表示午夜，12表示正午
> - 星期字段中，0和7都表示周日
> - 月份和日期从1开始计算，不是从0开始

### 2.3 字段组合理解


```
示例解析：30 14 15 3 1
         │  │  │  │ │
         │  │  │  │ └─ 星期一
         │  │  │  └─── 3月份  
         │  │  └────── 15号
         │  └───────── 下午2点
         └──────────── 30分

含义：每年3月份的周一，如果那天是15号，就在下午2点30分执行
```

---

## 3. 🎯 特殊字符与通配符使用


### 3.1 星号通配符 (*)


**含义**：匹配该字段的所有可能值

```
实际应用：
* * * * *  → 每分钟执行一次
0 * * * *  → 每小时的0分执行（每小时执行一次）
0 0 * * *  → 每天凌晨0点执行
0 0 1 * *  → 每月1号凌晨0点执行
0 0 * * 0  → 每个周日凌晨0点执行
```

### 3.2 逗号分隔符 (,)


**含义**：列举多个具体值

```
使用示例：
0 8,12,18 * * *  → 每天8点、12点、18点执行
0 0 1,15 * *     → 每月1号和15号凌晨执行
0 0 * * 1,3,5    → 每周一、三、五凌晨执行
30 9 * 1,6,12 *  → 1月、6月、12月每天9:30执行
```

### 3.3 横线范围符 (-)


**含义**：表示连续的时间范围

```
使用示例：
0 9-17 * * *     → 每天9点到17点之间每小时执行
0 0 * * 1-5      → 周一到周五凌晨执行（工作日）
0 8 1-7 * *      → 每月1号到7号上午8点执行
30 14 * 3-5 *    → 3月到5月每天14:30执行
```

### 3.4 斜线间隔符 (/)


**含义**：表示间隔频率，"每隔多久"

```
使用示例：
*/5 * * * *      → 每5分钟执行一次
0 */2 * * *      → 每2小时执行一次  
0 8 */3 * *      → 每3天上午8点执行
0 0 1 */2 *      → 每2个月1号凌晨执行
0 0 * * */2      → 每隔一天（每两天）凌晨执行
```

> 💡 **实用技巧**  
> `*/n` 等价于 `0-最大值/n`，比如 `*/5` 在分钟字段等价于 `0,5,10,15,20,25,30,35,40,45,50,55`

### 3.5 特殊字符组合使用


```
复杂组合示例：
*/10 8-18 * * 1-5    → 工作日8-18点每10分钟执行
0 9,14 1-15 * *      → 每月前半月9点和14点执行
*/5 */2 * * *        → 每2小时内每5分钟执行
0 8-12,14-18 * * 1-5 → 工作日上午和下午各整点执行
```

---

## 4. 🔧 时间表达式组合规则


### 4.1 字段间的逻辑关系


**基本原则**：各字段之间是**AND关系**，必须同时满足所有条件。

```
错误理解：
0 0 15 * 0  → 认为是"每月15号或每周日执行"

正确理解：  
0 0 15 * 0  → 必须同时满足：
             - 0分0秒
             - 每月15号  
             - 并且那天是周日
             - 实际很少执行（只有15号恰好是周日才执行）
```

### 4.2 日期与星期的特殊处理


**重要规则**：当日期和星期字段都不是`*`时，它们是**OR关系**。

```
示例分析：
0 0 1,15 * 1  → 执行时机：
                - 每月1号凌晨（无论星期几）
                - 每月15号凌晨（无论星期几）  
                - 每周一凌晨（无论几号）

实际效果：比预期执行次数更多
```

### 4.3 避免常见组合错误


```
❌ 错误写法：
0 0 29,30,31 2 *  → 2月没有29/30/31号，永远不执行

❌ 错误写法：  
0 25 * * *        → 25点不存在，应该是0-23

✅ 正确写法：
0 0 28 2 *        → 每年2月28日执行
0 1 * * *         → 每天凌晨1点执行
```

---

## 5. 📝 特殊时间关键字


### 5.1 预定义时间关键字


cron支持一些预定义的时间关键字，让常用时间模式更简洁：

| 关键字 | **等价表达式** | **执行频率** | **适用场景** |
|--------|---------------|-------------|-------------|
| `@yearly` | `0 0 1 1 *` | 每年1月1日凌晨 | 年度任务 |
| `@annually` | `0 0 1 1 *` | 同@yearly | 年度报告 |
| `@monthly` | `0 0 1 * *` | 每月1日凌晨 | 月度统计 |
| `@weekly` | `0 0 * * 0` | 每周日凌晨 | 周度备份 |
| `@daily` | `0 0 * * *` | 每天凌晨 | 日常维护 |
| `@midnight` | `0 0 * * *` | 同@daily | 夜间任务 |
| `@hourly` | `0 * * * *` | 每小时整点 | 监控检查 |

### 5.2 关键字使用示例


```bash
# 使用关键字（推荐）
@daily    /usr/bin/backup.sh
@weekly   /usr/bin/cleanup.sh
@monthly  /usr/bin/report.sh

# 等价的完整表达式
0 0 * * * /usr/bin/backup.sh
0 0 * * 0 /usr/bin/cleanup.sh  
0 0 1 * * /usr/bin/report.sh
```

> 💡 **使用建议**  
> 对于标准的时间间隔，优先使用关键字，代码更清晰易读。

---

## 6. 🌟 常见时间模式示例


### 6.1 基础频率模式


```bash
# 每分钟执行
* * * * * /usr/bin/check-status.sh

# 每5分钟执行  
*/5 * * * * /usr/bin/monitor.sh

# 每小时执行
0 * * * * /usr/bin/hourly-task.sh

# 每天凌晨2点执行
0 2 * * * /usr/bin/daily-backup.sh

# 每周日凌晨3点执行
0 3 * * 0 /usr/bin/weekly-cleanup.sh

# 每月1号凌晨1点执行
0 1 1 * * /usr/bin/monthly-report.sh
```

### 6.2 工作日时间模式


```bash
# 工作日每天上午9点
0 9 * * 1-5 /usr/bin/workday-start.sh

# 工作日每2小时执行
0 */2 * * 1-5 /usr/bin/business-check.sh

# 工作日午休时间（12:30）
30 12 * * 1-5 /usr/bin/lunch-reminder.sh

# 周末凌晨执行维护
0 2 * * 6,0 /usr/bin/weekend-maintenance.sh
```

### 6.3 复杂业务模式


```bash
# 每个工作日的工作时间内每30分钟检查
*/30 9-17 * * 1-5 /usr/bin/office-hours-check.sh

# 每月第一个工作日上午8点
0 8 1-7 * 1 /usr/bin/monthly-start.sh

# 每季度末最后一天
0 0 31 3,6,9,12 * /usr/bin/quarter-end.sh
0 0 30 6,9 * /usr/bin/quarter-end.sh
0 0 28,29 12 * /usr/bin/year-end-check.sh

# 夜间维护窗口（凌晨1-4点每小时）
0 1-4 * * * /usr/bin/night-maintenance.sh
```

### 6.4 系统维护模式


```bash
# 每天凌晨轮转日志
0 0 * * * /usr/sbin/logrotate /etc/logrotate.conf

# 每周清理临时文件
0 3 * * 0 /usr/bin/find /tmp -type f -mtime +7 -delete

# 每月更新系统软件包
0 4 1 * * /usr/bin/apt update && /usr/bin/apt upgrade -y

# 每小时检查磁盘空间
0 * * * * /usr/bin/df -h | /usr/bin/mail -s "Disk Status" admin@example.com
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基础概念


```
🔸 五字段格式：分 时 日 月 周，用空格分隔
🔸 取值范围：每个字段都有固定的数值范围
🔸 特殊字符：* , - / 四种基本符号
🔸 逻辑关系：字段间AND关系，日期和星期是OR关系
🔸 预定义关键字：@daily、@weekly等简化常用模式
```

### 7.2 时间表达式设计要点


**🔹 准确性原则**
```
明确需求：
- 具体什么时候执行？
- 执行频率是多少？
- 是否有特殊的时间限制？

避免歧义：
- 日期和星期不要同时指定具体值
- 注意月份天数差异（2月、30天月份等）
- 考虑时区和夏令时影响
```

**🔹 效率优化原则**
```
合理安排时间：
- 避免在系统繁忙时执行大任务
- 错开多个任务的执行时间
- 考虑任务执行时长

资源使用：
- 数据备份选择凌晨时间
- 系统维护选择深夜或周末
- 监控检查适当间隔
```

**🔹 维护性原则**
```
表达式可读性：
- 优先使用预定义关键字
- 添加注释说明复杂表达式
- 采用一致的时间格式

测试验证：
- 使用工具验证表达式正确性
- 测试边界条件（月末、年末等）
- 监控实际执行情况
```

### 7.3 常见错误与避免方法


| **错误类型** | **错误示例** | **正确写法** | **避免方法** |
|-------------|-------------|-------------|-------------|
| 🚫 时间范围错误 | `0 25 * * *` | `0 1 * * *` | 记住24小时制 |
| 🚫 日期月份错误 | `0 0 31 2 *` | `0 0 28 2 *` | 注意月份天数 |
| 🚫 星期数字错误 | `0 0 * * 8` | `0 0 * * 0` | 星期0-7范围 |
| 🚫 逻辑关系错误 | `0 0 1 * 1` | `0 0 1 * *`或`0 0 * * 1` | 理解OR关系 |

### 7.4 实际应用指导


**🎯 选择合适的时间模式**
- **高频监控**：使用 `*/n` 格式，如 `*/5 * * * *`
- **日常维护**：使用 `@daily` 或指定具体时间
- **周期报告**：使用 `@weekly`、`@monthly` 
- **业务需求**：组合使用多种字符

**📊 性能考虑**
- 避免所有任务在同一时间执行
- 大任务选择系统空闲时间
- 考虑任务间的依赖关系
- 合理设置执行间隔

**🔍 调试与验证**
```bash
# 使用crontab命令查看当前任务
crontab -l

# 检查cron服务状态
systemctl status cron

# 查看cron执行日志
tail -f /var/log/cron
```

**核心记忆口诀**：
- 分时日月周，五个字段要记清
- 星号代表全，逗号列举值
- 横线表范围，斜线表间隔
- 日期星期OR，其他字段AND
- 预定义关键字，常用更简洁