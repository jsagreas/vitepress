---
title: 8ã€systemd timerå®šæ—¶å™¨
---
## ğŸ“š ç›®å½•

1. [systemd timeråŸºæœ¬æ¦‚å¿µ](#1-systemd-timeråŸºæœ¬æ¦‚å¿µ)
2. [timerå•å…ƒæ–‡ä»¶æ ¼å¼è¯¦è§£](#2-timerå•å…ƒæ–‡ä»¶æ ¼å¼è¯¦è§£)
3. [æ—¶é—´è¡¨è¾¾å¼ä¸è§¦å‘æ–¹å¼](#3-æ—¶é—´è¡¨è¾¾å¼ä¸è§¦å‘æ–¹å¼)
4. [timerä¸serviceå•å…ƒå…³è”](#4-timerä¸serviceå•å…ƒå…³è”)
5. [é«˜çº§ç‰¹æ€§ä¸é…ç½®é€‰é¡¹](#5-é«˜çº§ç‰¹æ€§ä¸é…ç½®é€‰é¡¹)
6. [å®é™…åº”ç”¨æ¡ˆä¾‹](#6-å®é™…åº”ç”¨æ¡ˆä¾‹)
7. [ç®¡ç†ä¸è°ƒè¯•æ–¹æ³•](#7-ç®¡ç†ä¸è°ƒè¯•æ–¹æ³•)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ systemd timeråŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯systemd timer


**é€šä¿—ç†è§£**ï¼šsystemd timerå°±åƒä¸€ä¸ªæ™ºèƒ½çš„"é—¹é’Ÿç³»ç»Ÿ"ï¼Œå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
ç”¨æˆ· â†’ è®¾ç½®cronä»»åŠ¡ â†’ cronå®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œ

systemdæ–¹å¼ï¼š
ç”¨æˆ· â†’ åˆ›å»ºtimerå•å…ƒ â†’ systemdç®¡ç†æ‰§è¡Œ
```

**ğŸ”¸ æ ¸å¿ƒç‰¹ç‚¹**
```
ç°ä»£åŒ–è®¾è®¡ï¼š
â€¢ é›†æˆåˆ°systemdç”Ÿæ€ç³»ç»Ÿä¸­
â€¢ ç»Ÿä¸€çš„é…ç½®æ ¼å¼å’Œç®¡ç†æ–¹å¼
â€¢ æ›´å¥½çš„æ—¥å¿—è®°å½•å’Œç›‘æ§èƒ½åŠ›

åŠŸèƒ½å¢å¼ºï¼š
â€¢ æ”¯æŒæ›´çµæ´»çš„æ—¶é—´è¡¨è¾¾å¼
â€¢ å¯ä»¥ä¾èµ–å…¶ä»–æœåŠ¡çŠ¶æ€
â€¢ æä¾›éšæœºå»¶æ—¶å’ŒæŒä¹…åŒ–é€‰é¡¹
```

### 1.2 timer vs cronå¯¹æ¯”


| **å¯¹æ¯”ç»´åº¦** | **systemd timer** | **ä¼ ç»Ÿcron** |
|-------------|-------------------|--------------|
| **ç®¡ç†æ–¹å¼** | `systemctlå‘½ä»¤ç»Ÿä¸€ç®¡ç†` | `crontabå‘½ä»¤ç‹¬ç«‹ç®¡ç†` |
| **æ—¥å¿—è®°å½•** | `é›†æˆåˆ°systemdæ—¥å¿—ç³»ç»Ÿ` | `éœ€è¦æ‰‹åŠ¨é…ç½®æ—¥å¿—` |
| **ä¾èµ–ç®¡ç†** | `å¯ä»¥ä¾èµ–å…¶ä»–æœåŠ¡` | `æ— ä¾èµ–ç®¡ç†æœºåˆ¶` |
| **ç²¾åº¦æ§åˆ¶** | `æ”¯æŒå¾®ç§’çº§ç²¾åº¦` | `æœ€å°ç²’åº¦ä¸ºåˆ†é’Ÿ` |
| **å¤±æ•ˆå¤„ç†** | `æ”¯æŒæŒä¹…åŒ–ä»»åŠ¡` | `é”™è¿‡æ—¶é—´å°±ä¸¢å¤±` |
| **éšæœºå»¶æ—¶** | `å†…ç½®éšæœºå»¶æ—¶åŠŸèƒ½` | `éœ€è¦æ‰‹åŠ¨å®ç°` |

**ğŸ’¡ é€‰æ‹©å»ºè®®**
```
ä½¿ç”¨systemd timerçš„åœºæ™¯ï¼š
âœ… éœ€è¦å¤æ‚çš„ä¾èµ–å…³ç³»ç®¡ç†
âœ… è¦æ±‚ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶
âœ… éœ€è¦ä¸å…¶ä»–systemdæœåŠ¡é›†æˆ
âœ… å¯¹æ—¥å¿—è®°å½•æœ‰è¾ƒé«˜è¦æ±‚

ç»§ç»­ä½¿ç”¨cronçš„åœºæ™¯ï¼š
âœ… ç®€å•çš„å®šæ—¶ä»»åŠ¡
âœ… ä¼ ç»Ÿç¯å¢ƒå…¼å®¹æ€§è¦æ±‚
âœ… ä¹ æƒ¯cronè¯­æ³•
```

---

## 2. ğŸ“„ timerå•å…ƒæ–‡ä»¶æ ¼å¼è¯¦è§£


### 2.1 .timeræ–‡ä»¶åŸºæœ¬ç»“æ„


**æ–‡ä»¶ä½ç½®è¯´æ˜**ï¼š
```
ç³»ç»Ÿçº§timerå•å…ƒï¼š/etc/systemd/system/
ç”¨æˆ·çº§timerå•å…ƒï¼š~/.config/systemd/user/
```

**åŸºæœ¬æ ¼å¼ç¤ºä¾‹**ï¼š
```ini
[Unit]
Description=å®šæ—¶ä»»åŠ¡æè¿°
Requires=å…³è”çš„serviceå•å…ƒ

[Timer]
OnCalendar=*:0/10
Persistent=true

[Install]
WantedBy=timers.target
```

### 2.2 [Unit]æ®µé…ç½®è¯¦è§£


**ğŸ”¸ åŸºæœ¬ä¿¡æ¯é…ç½®**
```ini
[Unit]
# æè¿°ä¿¡æ¯ï¼Œæ–¹ä¾¿è¯†åˆ«ä»»åŠ¡ç”¨é€”
Description=æ¯æ—¥ç³»ç»Ÿå¤‡ä»½ä»»åŠ¡

# æ–‡æ¡£é“¾æ¥ï¼Œæä¾›è¯¦ç»†è¯´æ˜
Documentation=man:backup(8)

# ä¾èµ–å…³ç³»ï¼šéœ€è¦å“ªäº›æœåŠ¡å…ˆå¯åŠ¨
Requires=network.target

# æ’åºå…³ç³»ï¼šåœ¨å“ªäº›æœåŠ¡ä¹‹åå¯åŠ¨
After=network.target

# å†²çªå…³ç³»ï¼šä¸èƒ½åŒæ—¶è¿è¡Œçš„æœåŠ¡
Conflicts=maintenance.service
```

**ä¾èµ–å…³ç³»è¯¦è§£**ï¼š
```
Requiresï¼šå¼ºä¾èµ–ï¼Œè¢«ä¾èµ–æœåŠ¡å¤±è´¥ä¼šå¯¼è‡´timerå¤±è´¥
Wantsï¼šå¼±ä¾èµ–ï¼Œè¢«ä¾èµ–æœåŠ¡å¤±è´¥ä¸å½±å“timer
Before/Afterï¼šå¯åŠ¨é¡ºåºæ§åˆ¶
Conflictsï¼šäº’æ–¥å…³ç³»ï¼Œä¸èƒ½åŒæ—¶è¿è¡Œ
```

### 2.3 [Timer]æ®µæ ¸å¿ƒé…ç½®


**æ—¶é—´è§¦å‘é…ç½®**ï¼š
```ini
[Timer]
# åŸºäºæ—¥å†æ—¶é—´çš„å®šæ—¶
OnCalendar=daily
# ç­‰ä»·äºï¼šOnCalendar=*-*-* 00:00:00

# åŸºäºå¯åŠ¨æ—¶é—´çš„å®šæ—¶
OnBootSec=15min
# ç³»ç»Ÿå¯åŠ¨15åˆ†é’Ÿåæ‰§è¡Œ

# åŸºäºå•å…ƒæ¿€æ´»æ—¶é—´çš„å®šæ—¶
OnUnitActiveSec=1h
# ä¸Šæ¬¡ä»»åŠ¡å®Œæˆ1å°æ—¶åå†æ¬¡æ‰§è¡Œ

# åŸºäºå•å…ƒä¸æ´»è·ƒæ—¶é—´çš„å®šæ—¶
OnUnitInactiveSec=30min
# å•å…ƒåœæ­¢30åˆ†é’Ÿåæ‰§è¡Œ
```

---

## 3. â° æ—¶é—´è¡¨è¾¾å¼ä¸è§¦å‘æ–¹å¼


### 3.1 OnCalendaræ—¶é—´è¡¨è¾¾å¼è¯¦è§£


**ğŸ”¸ åŸºæœ¬è¯­æ³•æ ¼å¼**
```
å®Œæ•´æ ¼å¼ï¼šå¹´-æœˆ-æ—¥ æ˜ŸæœŸ æ—¶:åˆ†:ç§’
ç®€åŒ–æ ¼å¼ï¼šæ—¶:åˆ† æˆ– æ—¶:åˆ†:ç§’
```

**å¸¸ç”¨æ—¶é—´è¡¨è¾¾å¼ç¤ºä¾‹**ï¼š
```ini
# æ¯å¤©å‡Œæ™¨2ç‚¹
OnCalendar=*-*-* 02:00:00
OnCalendar=02:00  # ç®€åŒ–å†™æ³•

# æ¯å‘¨ä¸€ä¸Šåˆ9ç‚¹
OnCalendar=Mon 09:00

# æ¯æœˆ1å·å‡Œæ™¨3ç‚¹
OnCalendar=*-*-01 03:00:00

# æ¯å¹´1æœˆ1æ—¥
OnCalendar=*-01-01 00:00:00

# å·¥ä½œæ—¥æ¯å°æ—¶æ‰§è¡Œ
OnCalendar=Mon..Fri *:00:00

# æ¯10åˆ†é’Ÿæ‰§è¡Œ
OnCalendar=*:0/10  # 0,10,20,30,40,50åˆ†

# æ¯2å°æ—¶æ‰§è¡Œ
OnCalendar=0/2:00  # 0,2,4,6,8...ç‚¹
```

**ğŸ” æ—¶é—´è¡¨è¾¾å¼è§„åˆ™**ï¼š
```
å¹´ä»½ï¼šå››ä½æ•°å­—æˆ–*
æœˆä»½ï¼š01-12æˆ–*
æ—¥æœŸï¼š01-31æˆ–*
æ˜ŸæœŸï¼šMon,Tue,Wed,Thu,Fri,Sat,Sun
æ—¶é—´ï¼š24å°æ—¶æ ¼å¼

ç‰¹æ®Šç¬¦å·ï¼š
* ï¼šåŒ¹é…æ‰€æœ‰å€¼
/ ï¼šé—´éš”ç¬¦å·ï¼Œå¦‚0/5è¡¨ç¤ºæ¯5ä¸ªå•ä½
.. ï¼šèŒƒå›´ç¬¦å·ï¼Œå¦‚Mon..Friè¡¨ç¤ºå‘¨ä¸€åˆ°å‘¨äº”
, ï¼šåˆ—ä¸¾ç¬¦å·ï¼Œå¦‚1,15è¡¨ç¤º1å·å’Œ15å·
```

### 3.2 ç›¸å¯¹æ—¶é—´è§¦å‘æ–¹å¼


**å¯åŠ¨åå»¶æ—¶è§¦å‘**ï¼š
```ini
[Timer]
# ç³»ç»Ÿå¯åŠ¨å5åˆ†é’Ÿæ‰§è¡Œ
OnBootSec=5min

# æ”¯æŒçš„æ—¶é—´å•ä½
OnBootSec=30s      # 30ç§’
OnBootSec=10min    # 10åˆ†é’Ÿ  
OnBootSec=2h       # 2å°æ—¶
OnBootSec=1d       # 1å¤©
OnBootSec=1w       # 1å‘¨
```

**å•å…ƒæ¿€æ´»åè§¦å‘**ï¼š
```ini
[Timer]
# å…³è”æœåŠ¡å®Œæˆå1å°æ—¶å†æ¬¡æ‰§è¡Œ
OnUnitActiveSec=1h

# å¸¸ç”¨åœºæ™¯ï¼šé‡å¤æ€§ä»»åŠ¡
# é€‚åˆä¸éœ€è¦ä¸¥æ ¼æ—¶é—´ç‚¹çš„å¾ªç¯ä»»åŠ¡
```

**å•å…ƒä¸æ´»è·ƒåè§¦å‘**ï¼š
```ini
[Timer]
# å…³è”æœåŠ¡åœæ­¢30åˆ†é’Ÿåæ‰§è¡Œ
OnUnitInactiveSec=30min

# é€‚åˆåœºæ™¯ï¼šæ¸…ç†ä»»åŠ¡ã€å¥åº·æ£€æŸ¥
```

### 3.3 æ—¶é—´è¡¨è¾¾å¼æµ‹è¯•ä¸éªŒè¯


**éªŒè¯æ—¶é—´è¡¨è¾¾å¼**ï¼š
```bash
# æµ‹è¯•æ—¶é—´è¡¨è¾¾å¼çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
systemd-analyze calendar "Mon 09:00"

# æŸ¥çœ‹timerçš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
systemctl list-timers

# éªŒè¯å¤æ‚è¡¨è¾¾å¼
systemd-analyze calendar "*-*-01,15 12:00"
```

---

## 4. ğŸ”— timerä¸serviceå•å…ƒå…³è”


### 4.1 å…³è”æœºåˆ¶è¯´æ˜


**ğŸ”¸ é»˜è®¤å…³è”è§„åˆ™**ï¼š
```
å‘½åçº¦å®šå…³è”ï¼š
backup.timer â†’ è‡ªåŠ¨å…³è” â†’ backup.service

æ‰‹åŠ¨æŒ‡å®šå…³è”ï¼š
[Timer]
Unit=custom-service.service
```

**å®Œæ•´ç¤ºä¾‹**ï¼š
```
æ–‡ä»¶1ï¼šbackup.timer
æ–‡ä»¶2ï¼šbackup.service
systemdä¼šè‡ªåŠ¨å»ºç«‹å…³è”å…³ç³»
```

### 4.2 åˆ›å»ºserviceå•å…ƒ


**backup.serviceç¤ºä¾‹**ï¼š
```ini
[Unit]
Description=ç³»ç»Ÿå¤‡ä»½æœåŠ¡
After=network.target

[Service]
Type=oneshot
User=backup
Group=backup

# æ‰§è¡Œçš„å…·ä½“å‘½ä»¤
ExecStart=/usr/local/bin/backup-script.sh

# å·¥ä½œç›®å½•
WorkingDirectory=/var/backups

# ç¯å¢ƒå˜é‡
Environment="BACKUP_DIR=/var/backups"
Environment="LOG_LEVEL=INFO"

# è¶…æ—¶è®¾ç½®
TimeoutStartSec=3600

[Install]
WantedBy=multi-user.target
```

**ğŸ”¸ Serviceç±»å‹è¯´æ˜**ï¼š
```
Type=oneshotï¼š
â€¢ é€‚åˆï¼šä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå¦‚å¤‡ä»½ã€æ¸…ç†
â€¢ ç‰¹ç‚¹ï¼šæ‰§è¡Œå®Œæˆåå³é€€å‡º

Type=simpleï¼š
â€¢ é€‚åˆï¼šé•¿æœŸè¿è¡Œçš„è¿›ç¨‹
â€¢ ç‰¹ç‚¹ï¼šä¸»è¿›ç¨‹ä¸ä¼šfork

Type=forkingï¼š
â€¢ é€‚åˆï¼šä¼ ç»Ÿçš„å®ˆæŠ¤è¿›ç¨‹
â€¢ ç‰¹ç‚¹ï¼šä¸»è¿›ç¨‹ä¼šforkåå°è¿è¡Œ
```

### 4.3 timerå•å…ƒå®Œæ•´é…ç½®


**backup.timerå®Œæ•´ç¤ºä¾‹**ï¼š
```ini
[Unit]
Description=æ¯æ—¥å¤‡ä»½å®šæ—¶å™¨
Requires=backup.service
Documentation=man:backup(8)

[Timer]
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
OnCalendar=*-*-* 02:00:00

# å¯ç”¨æŒä¹…åŒ–ï¼Œç³»ç»Ÿé‡å¯åè¡¥æ‰§è¡Œé”™è¿‡çš„ä»»åŠ¡
Persistent=true

# éšæœºå»¶æ—¶0-30åˆ†é’Ÿï¼Œé¿å…å¤šç³»ç»ŸåŒæ—¶å¤‡ä»½
RandomizedDelaySec=30min

# ä»»åŠ¡è¶…æ—¶æ—¶é—´
AccuracySec=1min

[Install]
WantedBy=timers.target
```

---

## 5. ğŸ›  é«˜çº§ç‰¹æ€§ä¸é…ç½®é€‰é¡¹


### 5.1 PersistentæŒä¹…åŒ–é€‰é¡¹


**æŒä¹…åŒ–æœºåˆ¶è¯´æ˜**ï¼š
```ini
[Timer]
Persistent=true
```

**ğŸ”¸ æŒä¹…åŒ–å·¥ä½œåŸç†**ï¼š
```
å¯ç”¨æŒä¹…åŒ–åï¼š
1. systemdè®°å½•ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´
2. ç³»ç»Ÿé‡å¯æ—¶æ£€æŸ¥æ˜¯å¦é”™è¿‡æ‰§è¡Œæ—¶é—´
3. å¦‚æœé”™è¿‡ï¼Œç³»ç»Ÿå¯åŠ¨åç«‹å³æ‰§è¡Œä¸€æ¬¡

é€‚ç”¨åœºæ™¯ï¼š
â€¢ é‡è¦çš„å¤‡ä»½ä»»åŠ¡
â€¢ ç³»ç»Ÿç»´æŠ¤è„šæœ¬
â€¢ æ•°æ®åŒæ­¥ä»»åŠ¡
```

**çŠ¶æ€å­˜å‚¨ä½ç½®**ï¼š
```bash
# ç³»ç»Ÿçº§timerçŠ¶æ€
/var/lib/systemd/timers/

# ç”¨æˆ·çº§timerçŠ¶æ€
~/.local/share/systemd/
```

### 5.2 RandomizedDelaySecéšæœºå»¶æ—¶


**éšæœºå»¶æ—¶é…ç½®**ï¼š
```ini
[Timer]
OnCalendar=daily
RandomizedDelaySec=30min
```

**ğŸ”¸ éšæœºå»¶æ—¶ä½œç”¨**ï¼š
```
é—®é¢˜åœºæ™¯ï¼š
å¤šå°æœåŠ¡å™¨åŒæ—¶æ‰§è¡Œç›¸åŒä»»åŠ¡
â†’ ç½‘ç»œæ‹¥å µã€èµ„æºç«äº‰

è§£å†³æ–¹æ¡ˆï¼š
æ·»åŠ éšæœºå»¶æ—¶0-30åˆ†é’Ÿ
â†’ åˆ†æ•£æ‰§è¡Œæ—¶é—´ï¼Œé¿å…å†²çª

å®é™…æ•ˆæœï¼š
åŸå®š2:00æ‰§è¡Œ â†’ å®é™…åœ¨2:00-2:30é—´éšæœºæ‰§è¡Œ
```

### 5.3 AccuracySecç²¾åº¦æ§åˆ¶


**ç²¾åº¦è®¾ç½®**ï¼š
```ini
[Timer]
AccuracySec=1min
```

**ç²¾åº¦æ§åˆ¶è¯´æ˜**ï¼š
```
é»˜è®¤ç²¾åº¦ï¼š1åˆ†é’Ÿ
å«ä¹‰ï¼šå…è®¸åœ¨æŒ‡å®šæ—¶é—´å‰å1åˆ†é’Ÿå†…æ‰§è¡Œ

ä¼˜åŠ¿ï¼š
â€¢ å‡å°‘ç³»ç»Ÿå”¤é†’é¢‘ç‡
â€¢ é™ä½CPUä½¿ç”¨ç‡
â€¢ æ‰¹é‡å¤„ç†timeräº‹ä»¶

åœºæ™¯é€‰æ‹©ï¼š
é«˜ç²¾åº¦ä»»åŠ¡ï¼šAccuracySec=1s
ä¸€èˆ¬ä»»åŠ¡ï¼šAccuracySec=1min
ä½ç²¾åº¦ä»»åŠ¡ï¼šAccuracySec=1h
```

### 5.4 WakeSystemç³»ç»Ÿå”¤é†’


**ç³»ç»Ÿå”¤é†’é…ç½®**ï¼š
```ini
[Timer]
WakeSystem=true
```

**ğŸ”¸ å”¤é†’æœºåˆ¶è¯´æ˜**ï¼š
```
ä½œç”¨ï¼š
â€¢ å¯ä»¥ä»ç³»ç»Ÿä¼‘çœ /æŒ‚èµ·çŠ¶æ€å”¤é†’ç³»ç»Ÿ
â€¢ é€‚åˆç¬”è®°æœ¬ç”µè„‘æˆ–èŠ‚èƒ½æœåŠ¡å™¨

ä½¿ç”¨åœºæ™¯ï¼š
â€¢ å¤œé—´å¤‡ä»½ä»»åŠ¡
â€¢ å®šæ—¶æ›´æ–°æ£€æŸ¥
â€¢ ç³»ç»Ÿç»´æŠ¤è„šæœ¬

æ³¨æ„äº‹é¡¹ï¼š
â€¢ éœ€è¦ç¡¬ä»¶æ”¯æŒRTCå”¤é†’
â€¢ å¯èƒ½å½±å“ç”µæ± ç»­èˆª
```

---

## 6. ğŸ’¼ å®é™…åº”ç”¨æ¡ˆä¾‹


### 6.1 ç³»ç»Ÿå¤‡ä»½ä»»åŠ¡


**éœ€æ±‚**ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œç³»ç»Ÿå¤‡ä»½ï¼Œæ”¯æŒæ–­ç”µæ¢å¤

**backup.timer**ï¼š
```ini
[Unit]
Description=æ¯æ—¥ç³»ç»Ÿå¤‡ä»½ä»»åŠ¡
Documentation=file:///usr/share/doc/backup/README

[Timer]
OnCalendar=*-*-* 02:00:00
Persistent=true
RandomizedDelaySec=15min

[Install]
WantedBy=timers.target
```

**backup.service**ï¼š
```ini
[Unit]
Description=ç³»ç»Ÿå¤‡ä»½æœåŠ¡
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
User=backup
ExecStart=/usr/local/bin/daily-backup.sh
TimeoutStartSec=7200
```

### 6.2 æ—¥å¿—è½®è½¬ä»»åŠ¡


**éœ€æ±‚**ï¼šæ¯å‘¨æ—¥å‡Œæ™¨1ç‚¹æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶

**log-rotation.timer**ï¼š
```ini
[Unit]
Description=æ¯å‘¨æ—¥å¿—è½®è½¬ä»»åŠ¡

[Timer]
OnCalendar=Sun 01:00:00
Persistent=true

[Install]
WantedBy=timers.target
```

**log-rotation.service**ï¼š
```ini
[Unit]
Description=æ—¥å¿—è½®è½¬æœåŠ¡

[Service]
Type=oneshot
ExecStart=/usr/sbin/logrotate -f /etc/logrotate.conf
User=root
```

### 6.3 åº”ç”¨å¥åº·æ£€æŸ¥


**éœ€æ±‚**ï¼šæ¯5åˆ†é’Ÿæ£€æŸ¥åº”ç”¨çŠ¶æ€ï¼Œå¿…è¦æ—¶é‡å¯æœåŠ¡

**health-check.timer**ï¼š
```ini
[Unit]
Description=åº”ç”¨å¥åº·æ£€æŸ¥å®šæ—¶å™¨

[Timer]
OnBootSec=5min
OnUnitActiveSec=5min

[Install]
WantedBy=timers.target
```

**health-check.service**ï¼š
```ini
[Unit]
Description=åº”ç”¨å¥åº·æ£€æŸ¥æœåŠ¡

[Service]
Type=oneshot
ExecStart=/usr/local/bin/health-check.sh
User=monitor
TimeoutStartSec=60
```

### 6.4 ä¸´æ—¶æ–‡ä»¶æ¸…ç†


**éœ€æ±‚**ï¼šæ¯å°æ—¶æ¸…ç†/tmpç›®å½•ä¸­çš„è¿‡æœŸæ–‡ä»¶

**temp-cleanup.timer**ï¼š
```ini
[Unit]
Description=ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®šæ—¶å™¨

[Timer]
OnCalendar=hourly
RandomizedDelaySec=10min

[Install]
WantedBy=timers.target
```

---

## 7. ğŸ”§ ç®¡ç†ä¸è°ƒè¯•æ–¹æ³•


### 7.1 timerç®¡ç†å‘½ä»¤


**åŸºæœ¬ç®¡ç†æ“ä½œ**ï¼š
```bash
# å¯ç”¨å¹¶å¯åŠ¨timer
sudo systemctl enable backup.timer
sudo systemctl start backup.timer

# æŸ¥çœ‹timerçŠ¶æ€
systemctl status backup.timer

# åœæ­¢timer
sudo systemctl stop backup.timer

# ç¦ç”¨timer
sudo systemctl disable backup.timer

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload
sudo systemctl reload-or-restart backup.timer
```

**æŸ¥çœ‹æ‰€æœ‰timer**ï¼š
```bash
# åˆ—å‡ºæ‰€æœ‰æ´»åŠ¨çš„timer
systemctl list-timers

# åˆ—å‡ºæ‰€æœ‰timerï¼ˆåŒ…æ‹¬æœªæ¿€æ´»çš„ï¼‰
systemctl list-timers --all

# æŸ¥çœ‹ç”¨æˆ·çº§timer
systemctl --user list-timers
```

### 7.2 è°ƒè¯•ä¸æ•…éšœæ’æŸ¥


**æŸ¥çœ‹æ‰§è¡Œå†å²**ï¼š
```bash
# æŸ¥çœ‹timeræ—¥å¿—
journalctl -u backup.timer

# æŸ¥çœ‹å…³è”serviceæ—¥å¿—
journalctl -u backup.service

# å®æ—¶ç›‘æ§æ—¥å¿—
journalctl -fu backup.timer

# æŸ¥çœ‹æŒ‡å®šæ—¶é—´èŒƒå›´çš„æ—¥å¿—
journalctl -u backup.timer --since "2024-01-01" --until "2024-01-31"
```

**ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š
```bash
# 1. æ£€æŸ¥timeræ˜¯å¦æ­£ç¡®åŠ è½½
systemctl list-unit-files | grep backup

# 2. éªŒè¯æ—¶é—´è¡¨è¾¾å¼
systemd-analyze calendar "*-*-* 02:00:00"

# 3. æ£€æŸ¥ä¾èµ–å…³ç³»
systemctl show backup.timer

# 4. æŸ¥çœ‹ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
systemctl list-timers backup.timer

# 5. æ‰‹åŠ¨è§¦å‘æµ‹è¯•
sudo systemctl start backup.service
```

### 7.3 æ€§èƒ½ç›‘æ§


**timeræ€§èƒ½æŒ‡æ ‡**ï¼š
```bash
# æŸ¥çœ‹timerç»Ÿè®¡ä¿¡æ¯
systemd-analyze blame

# æŸ¥çœ‹timeræ‰§è¡Œæ—¶é—´
systemd-analyze critical-chain backup.timer

# ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨
systemctl status backup.service
```

**æ—¥å¿—åˆ†æç¤ºä¾‹**ï¼š
```bash
# ç»Ÿè®¡ä»»åŠ¡æ‰§è¡Œé¢‘ç‡
journalctl -u backup.timer | grep "Started" | wc -l

# æŸ¥æ‰¾å¤±è´¥çš„æ‰§è¡Œ
journalctl -u backup.service | grep "failed"

# åˆ†ææ‰§è¡Œæ—¶é•¿
journalctl -u backup.service | grep "Started\|Finished"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ systemd timeræœ¬è´¨ï¼šç°ä»£åŒ–çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œæ¯”cronæ›´å¼ºå¤§
ğŸ”¸ æ–‡ä»¶ç»“æ„ï¼š.timeræ–‡ä»¶å®šä¹‰è§¦å‘æ—¶æœºï¼Œ.serviceæ–‡ä»¶å®šä¹‰æ‰§è¡Œå†…å®¹
ğŸ”¸ æ—¶é—´è¡¨è¾¾å¼ï¼šOnCalendaræ”¯æŒçµæ´»çš„æ—¶é—´æ ¼å¼
ğŸ”¸ å…³è”æœºåˆ¶ï¼štimeré€šè¿‡å‘½åçº¦å®šæˆ–UnitæŒ‡ä»¤å…³è”service
ğŸ”¸ é«˜çº§ç‰¹æ€§ï¼šæŒä¹…åŒ–ã€éšæœºå»¶æ—¶ã€ç²¾åº¦æ§åˆ¶ç­‰å¢å¼ºåŠŸèƒ½
```

### 8.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ timeræ–‡ä»¶å¿…å¤‡é…ç½®**ï¼š
```ini
[Unit]
Description=ä»»åŠ¡æè¿°

[Timer]
OnCalendar=æ‰§è¡Œæ—¶é—´
Persistent=true  # é‡è¦ä»»åŠ¡å»ºè®®å¯ç”¨

[Install]
WantedBy=timers.target
```

**ğŸ”¹ serviceæ–‡ä»¶å¿…å¤‡é…ç½®**ï¼š
```ini
[Unit]
Description=æœåŠ¡æè¿°

[Service]
Type=oneshot    # å®šæ—¶ä»»åŠ¡é€šå¸¸ç”¨oneshot
ExecStart=æ‰§è¡Œå‘½ä»¤
TimeoutStartSec=è¶…æ—¶è®¾ç½®
```

**ğŸ”¹ å¸¸ç”¨ç®¡ç†å‘½ä»¤**ï¼š
```bash
systemctl enable/start/stop/status timeråç§°
systemctl list-timers  # æŸ¥çœ‹æ‰€æœ‰timer
journalctl -u timeråç§°  # æŸ¥çœ‹æ—¥å¿—
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ä½¿ç”¨åœºæ™¯åˆ¤æ–­**ï¼š
```
é€‰æ‹©systemd timerï¼š
âœ… éœ€è¦å¤æ‚çš„æ—¶é—´æ§åˆ¶
âœ… è¦æ±‚ä¸¥æ ¼çš„ä¾èµ–ç®¡ç†
âœ… éœ€è¦è¯¦ç»†çš„æ—¥å¿—è®°å½•
âœ… ä¸å…¶ä»–systemdæœåŠ¡é›†æˆ

ç»§ç»­ä½¿ç”¨cronï¼š
âœ… ç®€å•çš„å®šæ—¶ä»»åŠ¡
âœ… ä¼ ç»Ÿç¯å¢ƒå…¼å®¹æ€§
âœ… ç†Ÿæ‚‰cronè¯­æ³•
```

**æœ€ä½³å®è·µå»ºè®®**ï¼š
```
1. é‡è¦ä»»åŠ¡å¯ç”¨PersistentæŒä¹…åŒ–
2. å¤§å‹ä»»åŠ¡è®¾ç½®RandomizedDelaySecé¿å…å†²çª
3. åˆç†è®¾ç½®TimeoutStartSecé˜²æ­¢ä»»åŠ¡å¡æ­»
4. ä½¿ç”¨æè¿°æ€§çš„Descriptionä¾¿äºç®¡ç†
5. å®šæœŸæ£€æŸ¥journalctlæ—¥å¿—ç¡®ä¿ä»»åŠ¡æ­£å¸¸
```

### 8.4 æ•…éšœæ’æŸ¥æ€è·¯


```
é—®é¢˜æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥timeræ˜¯å¦å¯ç”¨ï¼šsystemctl is-enabled xxx.timer
2. æŸ¥çœ‹timerçŠ¶æ€ï¼šsystemctl status xxx.timer
3. éªŒè¯æ—¶é—´è¡¨è¾¾å¼ï¼šsystemd-analyze calendar "è¡¨è¾¾å¼"
4. æ£€æŸ¥serviceé…ç½®ï¼šsystemctl status xxx.service
5. æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—ï¼šjournalctl -u xxx.timer
6. æ‰‹åŠ¨æµ‹è¯•æ‰§è¡Œï¼šsystemctl start xxx.service
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- **timeré…æ—¶æœºï¼Œserviceå®šä»»åŠ¡**
- **OnCalendarè®¾æ—¶é—´ï¼ŒPersistentä¿æ‰§è¡Œ**
- **systemctlç®¡å…¨å±€ï¼ŒjournalctlæŸ¥æ—¥å¿—**
- **æµ‹è¯•éªŒè¯å¾ˆé‡è¦ï¼Œç›‘æ§æ—¥å¿—ä¿ç¨³å®š**