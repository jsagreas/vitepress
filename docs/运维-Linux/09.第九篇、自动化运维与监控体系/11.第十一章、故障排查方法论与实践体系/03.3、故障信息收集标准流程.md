---
title: 3、故障信息收集标准流程
---
## 📚 目录

1. [故障信息收集概述](#1-故障信息收集概述)
2. [故障现象描述标准化](#2-故障现象描述标准化)
3. [环境信息收集清单](#3-环境信息收集清单)
4. [时间线建立方法](#4-时间线建立方法)
5. [变更记录核查](#5-变更记录核查)
6. [日志收集范围与方法](#6-日志收集范围与方法)
7. [现场保护措施](#7-现场保护措施)
8. [关键文件备份](#8-关键文件备份)
9. [相关人员访谈记录](#9-相关人员访谈记录)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🔍 故障信息收集概述


### 1.1 为什么要标准化收集故障信息


**就像医生看病一样**，故障排查也需要"问诊"过程。医生不能随便开药，必须先了解症状、病史、体检结果。同样，运维工程师也不能凭感觉处理故障，必须先系统性地收集信息。

**信息收集的核心目标：**
- 🎯 **准确定位问题** - 避免盲目排查浪费时间
- 📊 **建立完整视图** - 从多个维度了解故障全貌
- 🔗 **发现关联关系** - 找出看似无关但实际相关的因素
- 📝 **为后续分析提供依据** - 确保有充足的线索进行深入分析

### 1.2 标准化收集的重要性


```
非标准化收集的问题：
用户说："系统慢了"
运维问："什么时候？"
用户答："就是慢"
运维问："慢多少？"
用户答："反正就是慢"
结果：信息不足，排查困难

标准化收集的效果：
1. 具体现象：登录页面从2秒变成15秒
2. 影响范围：所有用户，主要是web界面
3. 开始时间：今天上午10:30左右
4. 变更记录：10:00部署了新版本
5. 环境状态：CPU使用率90%，内存正常
结果：快速定位到性能瓶颈
```

---

## 2. 📝 故障现象描述标准化


### 2.1 现象描述的5W1H原则


**What（什么问题）**
```
标准描述格式：
[功能模块] + [具体现象] + [表现形式]

示例：
❌ 模糊描述："数据库有问题"
✅ 标准描述："用户登录模块无法连接MySQL数据库，报错Connection refused"

❌ 模糊描述："网站打不开"
✅ 标准描述："电商网站首页返回502错误，页面显示Bad Gateway"
```

**When（什么时候）**
```
时间记录要求：
- 精确到分钟级别
- 记录时区信息
- 标注持续时间

示例：
开始时间：2025-01-09 10:32 (UTC+8)
发现时间：2025-01-09 10:35 (UTC+8)
持续时间：已持续1小时30分钟
```

**Where（在哪里）**
```
位置信息包括：
- 物理位置：机房/服务器位置
- 逻辑位置：系统模块/服务组件
- 网络位置：IP地址/域名

示例：
物理位置：北京机房A区机柜R15-U10
逻辑位置：用户管理系统-认证服务模块
网络位置：192.168.1.100:3306
```

**Who（谁受影响）**
```
影响范围描述：
- 用户群体：所有用户/部分用户/特定用户
- 功能范围：全功能/核心功能/边缘功能
- 业务影响：停机/降级/缓慢

示例：
用户影响：约1000名活跃用户无法登录
功能影响：登录、注册功能完全不可用，已登录用户正常
业务影响：新用户无法注册，预计损失订单50+
```

**Why（为什么）**
```
初步原因分析：
- 表面现象
- 可能原因
- 排除项

示例：
表面现象：数据库连接超时
可能原因：
1. 数据库服务停止
2. 网络连接异常  
3. 连接池耗尽
4. 数据库性能瓶颈

已排除：服务器硬件故障（CPU、内存、磁盘正常）
```

**How（如何发现）**
```
发现方式：
- 监控告警
- 用户投诉
- 主动巡检
- 自动检测

示例：
发现方式：Zabbix监控告警 + 用户投诉
告警内容：MySQL连接数超过阈值(90%)
用户反馈：5位用户通过客服热线报告登录失败
```

### 2.2 故障严重级别定义


| 严重级别 | **影响范围** | **业务损失** | **响应时间** | **典型场景** |
|---------|------------|------------|------------|------------|
| 🔴 **P0-紧急** | `全系统停机` | `业务完全中断` | `15分钟内` | `数据库宕机、核心服务崩溃` |
| 🟠 **P1-严重** | `核心功能异常` | `主要业务受影响` | `1小时内` | `支付失败、登录异常` |
| 🟡 **P2-一般** | `部分功能异常` | `次要业务受影响` | `4小时内` | `报表显示错误、部分页面慢` |
| 🟢 **P3-轻微** | `边缘功能异常` | `用户体验下降` | `24小时内` | `界面样式问题、统计偏差` |

---

## 3. 💻 环境信息收集清单


### 3.1 系统版本信息收集


**操作系统信息**
```bash
# 基础系统信息
cat /etc/os-release          # 系统版本
uname -a                     # 内核版本
uptime                       # 运行时间
```

**应用版本信息**
```bash
# 常见应用版本检查
java -version               # Java版本
python --version           # Python版本
nginx -v                    # Nginx版本
mysql --version            # MySQL版本
```

**软件包版本**
```bash
# 包管理器相关
rpm -qa | grep package     # RHEL/CentOS已安装包
dpkg -l | grep package     # Ubuntu/Debian已安装包
pip list                    # Python包列表
```

### 3.2 硬件配置信息


**CPU信息**
```bash
# CPU详细信息
lscpu                       # CPU架构信息
cat /proc/cpuinfo          # 详细CPU信息
nproc                      # CPU核心数
```

**内存信息**
```bash
# 内存配置和使用情况
free -h                    # 内存使用概览
cat /proc/meminfo         # 详细内存信息
dmidecode -t memory       # 物理内存条信息
```

**存储信息**
```bash
# 磁盘和存储
df -h                      # 磁盘空间使用
lsblk                      # 块设备信息
fdisk -l                   # 磁盘分区信息
```

**网络硬件**
```bash
# 网络接口信息
ip addr show               # 网络接口配置
ethtool eth0              # 网卡详细信息
lspci | grep -i network   # PCI网络设备
```

### 3.3 网络拓扑信息


**网络连接图示**
```
                 互联网
                    |
              [防火墙/路由器]
                    |
        +----------[交换机]----------+
        |                           |
   [Web服务器]                 [数据库服务器]
   192.168.1.10               192.168.1.20
        |                           |
   [应用进程]                  [MySQL进程]
   端口:80/443                  端口:3306
```

**网络配置信息收集**
```bash
# 路由信息
ip route show              # 路由表
netstat -rn               # 路由表（备选）

# 网络连接
netstat -tulpn            # 监听端口和连接
ss -tulpn                 # 现代版netstat

# 防火墙规则
iptables -L -n            # 防火墙规则
systemctl status firewalld # 防火墙服务状态
```

---

## 4. ⏰ 时间线建立方法


### 4.1 时间线建立的意义


**时间线就像破案时的时间轴**，帮助我们理清事件发生的顺序，找出因果关系。

**时间线的作用：**
- 🔍 **发现触发因素** - 找出故障前的关键变化
- 📈 **分析发展趋势** - 了解问题如何逐步恶化
- ⚡ **确定关键节点** - 识别决定性的时间点
- 🎯 **指导排查方向** - 从时间线找到线索

### 4.2 时间线建立步骤


**第一步：确定时间范围**
```
建议时间范围设定：
- 故障前24小时 → 寻找可能的触发因素
- 故障发生期间 → 记录故障演进过程
- 故障后处理期间 → 记录应对措施效果

示例：
故障发现：2025-01-09 10:30
时间范围：2025-01-08 10:30 至 2025-01-09 15:30
```

**第二步：收集时间点事件**
```
事件来源：
✓ 系统日志时间戳
✓ 监控数据时间点
✓ 变更记录时间
✓ 用户反馈时间
✓ 运维操作时间
```

**第三步：建立时间轴**
```
时间线格式示例：

2025-01-09 09:00  [变更] 部署新版本应用 v2.1.3
2025-01-09 09:30  [正常] 系统运行正常，响应时间2秒
2025-01-09 10:15  [异常] 响应时间开始上升至5秒
2025-01-09 10:30  [告警] 响应时间超过10秒，触发告警
2025-01-09 10:35  [发现] 用户开始投诉，无法正常访问
2025-01-09 10:45  [分析] 开始故障排查，发现CPU使用率90%
2025-01-09 11:00  [处理] 重启应用服务
2025-01-09 11:05  [恢复] 系统恢复正常，响应时间回到2秒
```

### 4.3 时间线分析技巧


**寻找关键时间节点**
```
关键节点识别：
🔍 首次异常出现时间
⚠️  告警触发时间
📞 用户首次投诉时间
🛠️  开始处理时间
✅ 问题解决时间

分析要点：
- 异常出现与变更的时间关系
- 问题恶化的时间间隔
- 处理响应的及时性
```

---

## 5. 📋 变更记录核查


### 5.1 变更记录的重要性


**80%的故障都与变更相关**。就像交通事故往往发生在路况改变的时候，系统故障也往往发生在系统发生变化的时候。

**变更可能带来的影响：**
- 🔧 **代码变更** - 引入新的Bug或逻辑错误
- ⚙️ **配置变更** - 参数设置不当导致异常
- 🗄️ **数据变更** - 数据结构或内容变化引起问题
- 🏗️ **架构变更** - 系统架构调整导致兼容问题

### 5.2 变更记录核查清单


**应用层变更**
```
代码变更记录：
- Git提交记录和时间
- 代码Review记录
- 测试通过情况
- 部署时间和版本

检查命令：
git log --since="2025-01-08" --oneline     # 近期提交
git diff HEAD~1                           # 最新变更对比
```

**系统层变更**
```
配置文件变更：
- 系统配置文件修改时间
- 应用配置文件变更
- 环境变量修改
- 启动参数调整

检查方法：
ls -la /etc/nginx/nginx.conf              # 配置文件修改时间
find /etc -name "*.conf" -mtime -1         # 最近1天修改的配置
```

**基础设施变更**
```
硬件和网络变更：
- 服务器硬件维护记录
- 网络设备配置变更
- DNS解析变更
- 负载均衡配置调整

检查要点：
- 变更是否有审批流程
- 变更是否有回滚计划
- 变更时间与故障时间的关系
```

### 5.3 变更影响分析


**变更风险评估矩阵**

| 变更类型 | **风险级别** | **影响范围** | **核查重点** |
|---------|------------|------------|------------|
| 🔴 **核心代码** | `极高` | `全系统` | `功能测试、性能测试、兼容性` |
| 🟠 **数据库结构** | `高` | `相关模块` | `数据迁移、索引影响、性能` |
| 🟡 **配置参数** | `中` | `单个服务` | `参数合理性、依赖关系` |
| 🟢 **静态资源** | `低` | `前端展示` | `资源加载、缓存更新` |

---

## 6. 📊 日志收集范围与方法


### 6.1 日志收集的分层策略


**就像侦探收集证据一样**，日志收集需要全面而有重点。不同层次的日志提供不同角度的信息。

```
日志层次结构：
                应用日志
                   ↑
              中间件日志  
                   ↑
               系统日志
                   ↑
               硬件日志
```

### 6.2 系统级日志收集


**系统核心日志**
```bash
# 系统消息日志
tail -1000 /var/log/messages              # 系统消息
tail -1000 /var/log/syslog                # 系统日志(Ubuntu)
journalctl -f -u servicename              # systemd服务日志

# 系统启动和内核日志  
dmesg | tail -50                          # 内核消息
tail -100 /var/log/boot.log               # 启动日志
```

**认证和安全日志**
```bash
# 安全相关日志
tail -200 /var/log/secure                 # 认证日志(RHEL)
tail -200 /var/log/auth.log               # 认证日志(Ubuntu)
last -20                                  # 用户登录记录
```

### 6.3 应用级日志收集


**Web服务器日志**
```bash
# Nginx日志
tail -500 /var/log/nginx/access.log       # 访问日志
tail -500 /var/log/nginx/error.log        # 错误日志

# Apache日志
tail -500 /var/log/httpd/access_log       # 访问日志  
tail -500 /var/log/httpd/error_log        # 错误日志
```

**数据库日志**
```bash
# MySQL日志
tail -300 /var/log/mysqld.log             # MySQL主日志
mysql -e "SHOW PROCESSLIST;"              # 当前连接
mysql -e "SHOW ENGINE INNODB STATUS\G"    # InnoDB状态

# PostgreSQL日志
tail -300 /var/log/postgresql/postgresql.log
```

### 6.4 日志分析方法


**关键词搜索策略**
```bash
# 错误信息搜索
grep -i "error\|fail\|exception" /var/log/app.log

# 时间范围过滤
awk '/2025-01-09 10:00/,/2025-01-09 11:00/' /var/log/app.log

# 组合条件搜索
grep "2025-01-09 10:" /var/log/nginx/access.log | grep " 5[0-9][0-9] "
```

**日志统计分析**
```bash
# 错误频次统计
grep "ERROR" /var/log/app.log | cut -d' ' -f1,2 | uniq -c

# 访问IP统计
awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr

# 响应状态码统计  
awk '{print $9}' /var/log/nginx/access.log | sort | uniq -c
```

---

## 7. 🛡️ 现场保护措施


### 7.1 现场保护的重要性


**就像犯罪现场勘查一样**，系统故障现场也需要保护。一旦现场被破坏，重要线索可能永远丢失。

**现场保护的目的：**
- 🔒 **保存故障状态** - 确保能重现和分析问题
- 📸 **固定关键信息** - 防止重启或操作丢失线索
- 🎯 **支持深入分析** - 为后续详细分析提供基础
- 📚 **积累经验知识** - 为类似问题提供参考

### 7.2 进程和系统状态保护


**进程状态快照**
```bash
# 进程状态保存
ps aux > /tmp/processes_$(date +%Y%m%d_%H%M%S).txt
top -n 1 -b > /tmp/top_snapshot_$(date +%Y%m%d_%H%M%S).txt

# 内存使用状态
free -m > /tmp/memory_status_$(date +%Y%m%d_%H%M%S).txt
cat /proc/meminfo > /tmp/meminfo_$(date +%Y%m%d_%H%M%S).txt
```

**网络连接状态**
```bash
# 网络连接保存
netstat -tulpn > /tmp/netstat_$(date +%Y%m%d_%H%M%S).txt
ss -tulpn > /tmp/ss_$(date +%Y%m%d_%H%M%S).txt

# 路由表保存
ip route show > /tmp/routes_$(date +%Y%m%d_%H%M%S).txt
```

**系统资源使用**
```bash
# 磁盘使用状态
df -h > /tmp/disk_usage_$(date +%Y%m%d_%H%M%S).txt
lsof > /tmp/open_files_$(date +%Y%m%d_%H%M%S).txt
```

### 7.3 数据库状态保护


**MySQL状态保护**
```sql
-- 连接和进程信息
SHOW PROCESSLIST;
SHOW STATUS;
SHOW VARIABLES;

-- 性能相关信息
SHOW ENGINE INNODB STATUS;
SELECT * FROM information_schema.INNODB_METRICS;
```

**将结果保存到文件**
```bash
# MySQL状态导出
mysql -e "SHOW PROCESSLIST;" > /tmp/mysql_processes_$(date +%Y%m%d_%H%M%S).txt
mysql -e "SHOW ENGINE INNODB STATUS\G" > /tmp/mysql_innodb_$(date +%Y%m%d_%H%M%S).txt
```

### 7.4 现场保护操作规范


**保护措施检查清单**
```
✅ 停止自动化脚本和定时任务
✅ 通知相关人员勿进行操作
✅ 保存当前系统状态快照
✅ 备份关键配置和日志文件
✅ 记录当前所有运行进程
✅ 固定网络连接状态
✅ 保存数据库连接和状态信息
```

---

## 8. 💾 关键文件备份


### 8.1 文件备份的分类策略


**根据文件重要性分类备份**，就像整理重要文件时会把不同类型分开存放一样。

```
文件备份优先级：
P0级：配置文件、数据库文件
P1级：应用程序、脚本文件  
P2级：日志文件、临时文件
P3级：缓存文件、备份文件
```

### 8.2 系统配置文件备份


**核心配置文件**
```bash
# 系统配置备份目录
mkdir -p /tmp/backup/$(date +%Y%m%d_%H%M%S)/config

# 网络配置
cp -r /etc/sysconfig/network-scripts/ /tmp/backup/*/config/
cp /etc/resolv.conf /tmp/backup/*/config/

# 系统服务配置
cp -r /etc/systemd/system/ /tmp/backup/*/config/
cp /etc/hosts /tmp/backup/*/config/
```

**应用配置文件**
```bash
# Web服务器配置
cp -r /etc/nginx/ /tmp/backup/*/config/
cp -r /etc/httpd/ /tmp/backup/*/config/

# 数据库配置
cp /etc/my.cnf /tmp/backup/*/config/
cp -r /etc/mysql/ /tmp/backup/*/config/
```

### 8.3 应用程序和脚本备份


**应用程序备份**
```bash
# 应用程序目录
tar -czf /tmp/backup/app_$(date +%Y%m%d_%H%M%S).tar.gz /opt/app/

# 自定义脚本
cp -r /usr/local/bin/ /tmp/backup/*/scripts/
cp -r /opt/scripts/ /tmp/backup/*/scripts/
```

**数据库备份**
```bash
# MySQL数据备份
mysqldump --all-databases --routines --triggers > /tmp/backup/mysql_all_$(date +%Y%m%d_%H%M%S).sql

# PostgreSQL备份
pg_dumpall > /tmp/backup/postgresql_all_$(date +%Y%m%d_%H%M%S).sql
```

### 8.4 日志文件备份


**重要日志保存**
```bash
# 创建日志备份目录
mkdir -p /tmp/backup/$(date +%Y%m%d_%H%M%S)/logs

# 系统日志备份
cp /var/log/messages /tmp/backup/*/logs/
cp /var/log/secure /tmp/backup/*/logs/
cp -r /var/log/audit/ /tmp/backup/*/logs/

# 应用日志备份
cp -r /var/log/nginx/ /tmp/backup/*/logs/
cp -r /var/log/mysql/ /tmp/backup/*/logs/
cp -r /opt/app/logs/ /tmp/backup/*/logs/
```

---

## 9. 👥 相关人员访谈记录


### 9.1 访谈的重要性


**人是最重要的信息源**。系统日志只能告诉我们发生了什么，但只有人能告诉我们为什么会发生。

**访谈能获得的信息：**
- 🎯 **第一手观察** - 用户直接感受到的问题表现
- 🔍 **操作详情** - 故障前后进行的具体操作
- 💡 **经验判断** - 有经验人员的专业判断
- 📚 **历史信息** - 类似问题的历史经验

### 9.2 用户访谈记录


**用户访谈要点**
```
访谈对象：故障影响的直接用户
访谈重点：
1. 具体操作步骤
2. 异常现象描述
3. 影响程度评估
4. 时间节点确认

访谈记录格式：
时间：2025-01-09 11:30
访谈人：张三(用户)
访谈者：李四(运维工程师)

Q: 您是什么时候发现问题的？
A: 大概上午10点半，我想登录系统查看报表。

Q: 具体遇到了什么情况？
A: 点击登录按钮后，页面一直在转圈，等了很久都没反应。

Q: 之前有遇到过类似情况吗？
A: 没有，平时登录都很快的，2-3秒就进去了。
```

### 9.3 技术人员访谈


**开发人员访谈**
```
访谈重点：
✓ 近期代码变更情况
✓ 已知的潜在问题
✓ 系统设计的薄弱环节
✓ 历史故障处理经验

记录示例：
访谈对象：开发工程师王五
关键信息：
- 昨天晚上9点发布了新版本
- 新版本增加了数据统计功能
- 统计功能会定时查询大量历史数据
- 可能对数据库造成压力
```

**运维人员访谈**
```
访谈重点：
✓ 近期系统维护操作
✓ 监控告警历史
✓ 系统性能趋势
✓ 环境变化情况

记录示例：
访谈对象：运维工程师赵六  
关键信息：
- 上周进行了系统补丁更新
- 最近几天CPU使用率有上升趋势
- 数据库连接数接近上限
- 磁盘空间使用率85%
```

### 9.4 访谈信息整理


**访谈信息汇总表**

| 访谈时间 | **访谈对象** | **角色** | **关键信息** | **可信度** |
|---------|------------|---------|------------|-----------|
| `10:35` | `张三` | `最终用户` | `登录失败，页面无响应` | `高` |
| `11:00` | `李四` | `客服人员` | `接到5个用户投诉电话` | `高` |
| `11:30` | `王五` | `开发工程师` | `昨晚发布新版本，增加统计功能` | `很高` |
| `12:00` | `赵六` | `运维工程师` | `CPU使用率异常，连接数接近上限` | `很高` |

**信息交叉验证**
```
验证方法：
1. 将用户反馈与监控数据对比
2. 将开发人员提供的变更信息与部署记录核对
3. 将运维观察与系统日志进行印证
4. 寻找不同信息源的共同点和差异点

验证结果示例：
✓ 用户反馈的时间(10:30)与监控告警时间一致
✓ 开发人员提到的新功能与系统资源异常相关
✓ 多个信息源都指向数据库性能问题
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的基本概念


```
🔸 故障信息收集：系统性地获取故障相关的各类信息
🔸 标准化描述：使用统一格式准确描述故障现象  
🔸 环境信息：包括系统版本、硬件配置、网络拓扑的完整信息
🔸 时间线：按时间顺序记录事件发生过程的方法
🔸 变更记录：系统变化的详细记录和影响分析
🔸 日志分析：从各类日志中提取有价值信息的技能
🔸 现场保护：保持故障状态以便深入分析的措施
🔸 文件备份：对关键文件进行安全备份的策略
🔸 人员访谈：从相关人员获取第一手信息的方法
```

### 10.2 关键理解要点


**🔹 为什么要标准化收集**
```
效率提升：
- 结构化的信息便于快速分析
- 标准化的流程避免遗漏关键信息
- 规范化的记录便于经验传承

质量保证：
- 全面的信息收集提高问题定位准确性
- 标准的格式便于团队协作
- 完整的记录支持后续分析优化
```

**🔹 信息收集的层次性**
```
基础层：现象描述、时间记录、影响范围
技术层：系统状态、日志信息、配置参数  
分析层：关联关系、变更影响、根因分析
决策层：解决方案、预防措施、改进建议
```

**🔹 时间线的关键作用**
```
发现规律：通过时间序列发现问题发展规律
找到触发：识别故障的真正触发因素
评估影响：了解故障影响的扩散过程
指导处理：为故障处理提供时间参考
```

### 10.3 实际应用价值


**🎯 快速定位问题**
- 通过标准化收集快速获得关键信息
- 通过时间线分析快速找到问题根源
- 通过变更记录快速定位可能原因

**⚡ 提高处理效率**
- 减少盲目排查的时间浪费
- 避免重复收集相同信息
- 支持团队协作和知识共享

**🛡️ 预防类似问题**
- 完整的记录有助于总结经验教训
- 标准化的流程便于培训新人
- 系统化的分析支持预防性改进

### 10.4 实践操作要点


**信息收集技巧**
```
优先级排序：
1. 影响用户的核心功能问题
2. 系统稳定性相关信息
3. 性能和资源使用情况
4. 历史数据和趋势信息

时间管理：
- 紧急情况下先保护现场，再详细收集
- 非紧急情况下可以更全面深入收集
- 注意收集过程不要影响故障恢复

团队协作：
- 明确分工，避免重复收集
- 及时共享关键发现
- 保持沟通，确保信息一致性
```

**记录规范要求**
```
准确性：信息必须客观真实，不能主观臆断
完整性：关键信息不能遗漏，细节要记录清楚
及时性：信息要及时记录，避免遗忘和变化
标准性：使用统一格式，便于后续分析使用
```

**核心记忆要点**：
- 故障信息收集是排查工作的基础，决定着后续分析的质量
- 标准化流程能显著提高收集效率和信息质量  
- 时间线分析是发现问题根因的重要方法
- 人员访谈能提供系统无法记录的重要信息
- 现场保护和文件备份为深入分析提供保障