---
title: 5ã€æ—¥å¿—åˆ†æä¸æ¨¡å¼è¯†åˆ«
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿæ—¥å¿—åˆ†æç­–ç•¥](#1-ç³»ç»Ÿæ—¥å¿—åˆ†æç­–ç•¥)
2. [åº”ç”¨æ—¥å¿—å…³è”åˆ†æ](#2-åº”ç”¨æ—¥å¿—å…³è”åˆ†æ)
3. [é”™è¯¯æ¨¡å¼è¯†åˆ«æŠ€å·§](#3-é”™è¯¯æ¨¡å¼è¯†åˆ«æŠ€å·§)
4. [æ—¶é—´æˆ³å…³è”åˆ†æ](#4-æ—¶é—´æˆ³å…³è”åˆ†æ)
5. [æ—¥å¿—çº§åˆ«ç­›é€‰æ–¹æ³•](#5-æ—¥å¿—çº§åˆ«ç­›é€‰æ–¹æ³•)
6. [å…³é”®å­—æœç´¢ä¸è¿‡æ»¤](#6-å…³é”®å­—æœç´¢ä¸è¿‡æ»¤)
7. [æ—¥å¿—èšåˆåˆ†æå·¥å…·ä½¿ç”¨](#7-æ—¥å¿—èšåˆåˆ†æå·¥å…·ä½¿ç”¨)
8. [å¼‚å¸¸æ¨¡å¼ç»Ÿè®¡åˆ†æ](#8-å¼‚å¸¸æ¨¡å¼ç»Ÿè®¡åˆ†æ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ ç³»ç»Ÿæ—¥å¿—åˆ†æç­–ç•¥


### 1.1 /var/logç›®å½•ç»“æ„è§£æ


**ä»€ä¹ˆæ˜¯ç³»ç»Ÿæ—¥å¿—ï¼Ÿ**
> ç³»ç»Ÿæ—¥å¿—å°±åƒ"é»‘åŒ£å­"ï¼Œè®°å½•ç€ç³»ç»Ÿè¿è¡Œçš„æ¯ä¸ªé‡è¦æ—¶åˆ»ã€‚å°±åƒé£æœºçš„é£è¡Œè®°å½•å™¨ï¼Œå½“å‡ºç°é—®é¢˜æ—¶ï¼Œè¿™äº›è®°å½•èƒ½å¸®æˆ‘ä»¬æ‰¾åˆ°äº‹æ•…åŸå› ã€‚

```
/var/log/ ç›®å½•ç»“æ„ä¸€è§ˆï¼š
/var/log/
â”œâ”€â”€ messages          â† ç³»ç»Ÿç»¼åˆæ—¥å¿—ï¼ˆæœ€é‡è¦ï¼‰
â”œâ”€â”€ syslog           â† ç³»ç»Ÿäº‹ä»¶æ—¥å¿—
â”œâ”€â”€ auth.log         â† è®¤è¯ç›¸å…³æ—¥å¿—
â”œâ”€â”€ kern.log         â† å†…æ ¸æ¶ˆæ¯æ—¥å¿—
â”œâ”€â”€ dmesg            â† å†…æ ¸å¯åŠ¨ä¿¡æ¯
â”œâ”€â”€ secure           â† å®‰å…¨ç›¸å…³æ—¥å¿—
â”œâ”€â”€ cron.log         â† å®šæ—¶ä»»åŠ¡æ—¥å¿—
â”œâ”€â”€ boot.log         â† ç³»ç»Ÿå¯åŠ¨æ—¥å¿—
â”œâ”€â”€ wtmp             â† ç”¨æˆ·ç™»å½•å†å²
â”œâ”€â”€ btmp             â† å¤±è´¥ç™»å½•è®°å½•
â””â”€â”€ journal/         â† systemdæ—¥å¿—ç›®å½•
```

### 1.2 æ ¸å¿ƒç³»ç»Ÿæ—¥å¿—è¯¦è§£


#### ğŸ”¸ /var/log/messages - **ç³»ç»Ÿä¸»æ—¥å¿—**

è¿™æ˜¯**æœ€é‡è¦**çš„ç³»ç»Ÿæ—¥å¿—ï¼Œè®°å½•é™¤é‚®ä»¶ã€è®¤è¯å’Œè°ƒè¯•å¤–çš„æ‰€æœ‰ç³»ç»Ÿæ¶ˆæ¯ã€‚

**æ—¥å¿—æ ¼å¼è§£è¯»ï¼š**
```
æ—¶é—´æˆ³          ä¸»æœºå    è¿›ç¨‹[PID]:  æ¶ˆæ¯å†…å®¹
Sep 17 10:15:23 server01 kernel[0]: Out of memory: Kill process 1234
Sep 17 10:15:24 server01 systemd[1]: nginx.service: Main process exited
```

**å¸¸è§é—®é¢˜æ¨¡å¼ï¼š**
- `Out of memory` â†’ å†…å­˜ä¸è¶³ï¼Œè¿›ç¨‹è¢«æ€æ­»
- `segmentation fault` â†’ ç¨‹åºå´©æºƒ
- `failed` â†’ æœåŠ¡å¯åŠ¨å¤±è´¥
- `timeout` â†’ æ“ä½œè¶…æ—¶

#### ğŸ”¸ /var/log/auth.log - **è®¤è¯å®‰å…¨æ—¥å¿—**

è®°å½•æ‰€æœ‰ç”¨æˆ·è®¤è¯å’Œæˆæƒç›¸å…³äº‹ä»¶ã€‚

**å…³é”®äº‹ä»¶è¯†åˆ«ï¼š**
```
æˆåŠŸç™»å½•ï¼š
Sep 17 10:20:15 server01 sshd[2345]: Accepted password for user from 192.168.1.100

å¤±è´¥ç™»å½•ï¼š
Sep 17 10:20:30 server01 sshd[2346]: Failed password for root from 10.0.0.1

æƒé™æå‡ï¼š
Sep 17 10:25:10 server01 sudo: user : TTY=pts/0 ; PWD=/home/user ; USER=root ; COMMAND=/bin/ls
```

**å®‰å…¨å¨èƒè¯†åˆ«ï¼š**
- å¤§é‡å¤±è´¥ç™»å½• â†’ å¯èƒ½çš„æš´åŠ›ç ´è§£æ”»å‡»
- å¼‚å¸¸æ—¶é—´ç™»å½• â†’ å¯ç–‘è´¦æˆ·æ´»åŠ¨
- æƒé™æå‡å¼‚å¸¸ â†’ å¯èƒ½çš„æƒé™æ»¥ç”¨

#### ğŸ”¸ /var/log/kern.log - **å†…æ ¸æ—¥å¿—**

è®°å½•å†…æ ¸çº§åˆ«çš„æ¶ˆæ¯ï¼Œå¯¹ç³»ç»Ÿç¨³å®šæ€§åˆ†æè‡³å…³é‡è¦ã€‚

**ç¡¬ä»¶é—®é¢˜è¯†åˆ«ï¼š**
```
ç¡¬ç›˜é”™è¯¯ï¼š
kernel: ata1.00: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
kernel: ata1.00: BMDMA stat 0x25

å†…å­˜é”™è¯¯ï¼š
kernel: Machine check events logged
kernel: EDAC MC0: CE page 0x12345, offset 0x678

ç½‘ç»œé—®é¢˜ï¼š
kernel: e1000: eth0 NIC Link is Down
```

### 1.3 æ—¥å¿—è½®è½¬æœºåˆ¶ç†è§£


**ä»€ä¹ˆæ˜¯æ—¥å¿—è½®è½¬ï¼Ÿ**
> å°±åƒ"æ¢æ–°æœ¬å­å†™æ—¥è®°"ï¼Œå½“æ—¥å¿—æ–‡ä»¶å¤ªå¤§æ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºæ–°æ–‡ä»¶ç»§ç»­è®°å½•ï¼ŒæŠŠè€æ–‡ä»¶å‹ç¼©ä¿å­˜ã€‚

**è½®è½¬æ–‡ä»¶å‘½åè§„å¾‹ï¼š**
```
å½“å‰æ—¥å¿—ï¼šmessages
æ˜¨å¤©æ—¥å¿—ï¼šmessages.1
å‰å¤©æ—¥å¿—ï¼šmessages.2.gz
å¤§å‰å¤©ï¼š  messages.3.gz
...ä¾æ­¤ç±»æ¨
```

**logrotateé…ç½®ç¤ºä¾‹ï¼š**
```bash
# æŸ¥çœ‹è½®è½¬é…ç½®
cat /etc/logrotate.d/rsyslog

# å…¸å‹é…ç½®å†…å®¹
/var/log/messages {
    weekly          # æ¯å‘¨è½®è½¬ä¸€æ¬¡
    rotate 52       # ä¿ç•™52ä¸ªå¤‡ä»½æ–‡ä»¶
    compress        # å‹ç¼©æ—§æ–‡ä»¶
    delaycompress   # å»¶è¿Ÿä¸€ä¸ªå‘¨æœŸå†å‹ç¼©
    missingok       # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
    create 644 root root  # åˆ›å»ºæ–°æ–‡ä»¶çš„æƒé™
}
```

### 1.4 ç³»ç»Ÿæ—¥å¿—åˆ†æå®æˆ˜ç­–ç•¥


```
ğŸ¯ æ—¥å¿—åˆ†æçš„"é»„é‡‘ä¸‰æ­¥æ³•"ï¼š

ç¬¬1æ­¥ï¼šæ¦‚è§ˆæ‰«æ
tail -f /var/log/messages  # å®æ—¶ç›‘æ§
grep -i "error\|fail\|critical" /var/log/messages  # å¿«é€Ÿå‘ç°é—®é¢˜

ç¬¬2æ­¥ï¼šæ—¶é—´èŒƒå›´å®šä½  
sed -n '/Sep 17 10:00/,/Sep 17 11:00/p' /var/log/messages  # æŒ‡å®šæ—¶é—´æ®µ
journalctl --since "2025-09-17 10:00" --until "2025-09-17 11:00"

ç¬¬3æ­¥ï¼šæ·±åº¦å…³è”åˆ†æ
grep "nginx" /var/log/messages /var/log/auth.log /var/log/kern.log
# è·¨æ–‡ä»¶å…³è”åˆ†æ
```

**ç³»ç»Ÿå¥åº·å¿«é€Ÿæ£€æŸ¥ï¼š**
```bash
# ä¸€é”®ç³»ç»ŸçŠ¶æ€æ£€æŸ¥è„šæœ¬æ¦‚å¿µ
echo "=== æœ€è¿‘çš„ä¸¥é‡é”™è¯¯ ==="
grep -i "critical\|emergency\|alert" /var/log/messages | tail -10

echo "=== å†…å­˜/ç£ç›˜é—®é¢˜ ==="  
grep -i "out of memory\|no space\|i/o error" /var/log/messages | tail -5

echo "=== ç½‘ç»œé—®é¢˜ ==="
grep -i "network\|connection.*failed" /var/log/messages | tail -5

echo "=== æœåŠ¡å¼‚å¸¸ ==="
grep -i "service.*failed\|daemon.*died" /var/log/messages | tail -5
```

---

## 2. ğŸ”— åº”ç”¨æ—¥å¿—å…³è”åˆ†æ


### 2.1 åº”ç”¨æ—¥å¿—çš„åˆ†ç±»ä¸ä½ç½®


**åº”ç”¨æ—¥å¿—é€šå¸¸åœ¨å“ªé‡Œï¼Ÿ**
> ä¸åŒåº”ç”¨å°±åƒä¸åŒçš„"æˆ¿å®¢"ï¼Œå„è‡ªåœ¨ä¸åŒåœ°æ–¹å†™æ—¥è®°ã€‚äº†è§£å®ƒä»¬çš„"ä¹ æƒ¯"ï¼Œèƒ½å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„ä¿¡æ¯ã€‚

```
å¸¸è§åº”ç”¨æ—¥å¿—ä½ç½®ï¼š
WebæœåŠ¡å™¨ï¼š
  Apache: /var/log/apache2/ æˆ– /var/log/httpd/
  Nginx:  /var/log/nginx/
  
æ•°æ®åº“ï¼š
  MySQL:     /var/log/mysql/ æˆ– /var/log/mysqld.log
  PostgreSQL: /var/log/postgresql/
  
é‚®ä»¶æœåŠ¡ï¼š
  Postfix: /var/log/mail.log
  Dovecot: /var/log/dovecot.log
  
è‡ªå®šä¹‰åº”ç”¨ï¼š
  é€šå¸¸åœ¨ï¼š/var/log/åº”ç”¨å/ æˆ– /opt/åº”ç”¨å/logs/
```

### 2.2 WebæœåŠ¡å™¨æ—¥å¿—å…³è”åˆ†æ


#### ğŸ”¸ Apacheè®¿é—®æ—¥å¿—ä¸é”™è¯¯æ—¥å¿—å…³è”


**è®¿é—®æ—¥å¿—æ ¼å¼è§£è¯»ï¼š**
```
è®¿é—®æ—¥å¿—ç¤ºä¾‹ï¼ˆ/var/log/apache2/access.logï¼‰ï¼š
192.168.1.100 - - [17/Sep/2025:10:15:23 +0800] "GET /index.html HTTP/1.1" 200 2048
IPåœ°å€         ç”¨æˆ·  æ—¶é—´æˆ³                    è¯·æ±‚æ–¹æ³•  çŠ¶æ€ç  å“åº”å¤§å°

é”™è¯¯æ—¥å¿—ç¤ºä¾‹ï¼ˆ/var/log/apache2/error.logï¼‰ï¼š
[Wed Sep 17 10:15:23.123456 2025] [error] [pid 1234] File does not exist: /var/www/html/missing.html
```

**å…³è”åˆ†æå®æˆ˜ï¼š**
```bash
# æ‰¾å‡ºæŸä¸ªæ—¶é—´ç‚¹çš„é”™è¯¯åŠç›¸å…³è®¿é—®
æ—¶é—´ç‚¹="17/Sep/2025:10:15"

echo "=== é”™è¯¯æ—¥å¿— ==="
grep "$æ—¶é—´ç‚¹" /var/log/apache2/error.log

echo "=== å¯¹åº”çš„è®¿é—®è®°å½• ==="  
grep "$æ—¶é—´ç‚¹" /var/log/apache2/access.log | grep -E "4[0-9]{2}|5[0-9]{2}"
# æŸ¥æ‰¾4xxå’Œ5xxé”™è¯¯çŠ¶æ€ç 
```

#### ğŸ”¸ Nginxæ—¥å¿—åˆ†ææŠ€å·§


**Nginxæ—¥å¿—æ ¼å¼å®šåˆ¶ï¼š**
```nginx
# nginx.confä¸­çš„æ—¥å¿—æ ¼å¼å®šä¹‰
log_format detailed '$remote_addr - $remote_user [$time_local] '
                   '"$request" $status $body_bytes_sent '
                   '"$http_referer" "$http_user_agent" '
                   '$request_time $upstream_response_time';
```

**æ€§èƒ½é—®é¢˜å…³è”åˆ†æï¼š**
```bash
# åˆ†æå“åº”æ—¶é—´å¼‚å¸¸çš„è¯·æ±‚
awk '$NF > 5.0 {print $0}' /var/log/nginx/access.log
# æ‰¾å‡ºå“åº”æ—¶é—´è¶…è¿‡5ç§’çš„è¯·æ±‚

# ç»Ÿè®¡çŠ¶æ€ç åˆ†å¸ƒ
awk '{print $9}' /var/log/nginx/access.log | sort | uniq -c | sort -rn
# è¾“å‡ºç¤ºä¾‹ï¼š
#   1024 200
#    156 404  
#     23 500
```

### 2.3 æ•°æ®åº“æ—¥å¿—å…³è”åˆ†æ


#### ğŸ”¸ MySQLæ…¢æŸ¥è¯¢ä¸é”™è¯¯æ—¥å¿—å…³è”


**æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æï¼š**
```sql
-- MySQLé…ç½®å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 1;
SET GLOBAL slow_query_log_file = '/var/log/mysql/slow.log';
SET GLOBAL long_query_time = 2;  -- è¶…è¿‡2ç§’çš„æŸ¥è¯¢è®°å½•
```

**æ—¥å¿—å†…å®¹ç¤ºä¾‹ï¼š**
```
# Time: 2025-09-17T10:15:23.123456Z
# User@Host: webapp[webapp] @ [192.168.1.100]
# Query_time: 5.234567  Lock_time: 0.000123  Rows_sent: 1  Rows_examined: 1000000
SELECT * FROM users WHERE email LIKE '%@gmail.com%';
```

**å…³è”åˆ†ææ–¹æ³•ï¼š**
```bash
# åˆ†ææ…¢æŸ¥è¯¢è¶‹åŠ¿
grep "Query_time" /var/log/mysql/slow.log | \
awk '{print $2}' | \
awk '{sum+=$1; count++} END {print "å¹³å‡æŸ¥è¯¢æ—¶é—´:", sum/count "ç§’"}'

# æ‰¾å‡ºæœ€æ¶ˆè€—èµ„æºçš„æŸ¥è¯¢
grep -A 2 "Query_time" /var/log/mysql/slow.log | \
grep "Query_time" | \
sort -k2 -nr | \
head -10
```

### 2.4 åº”ç”¨æ—¥å¿—èšåˆç­–ç•¥


**ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—èšåˆï¼Ÿ**
> å°±åƒæŠŠæ•£è½å„å¤„çš„"è¯æ®"é›†ä¸­åˆ°ä¸€ä¸ªåœ°æ–¹åˆ†æï¼Œèƒ½çœ‹åˆ°å®Œæ•´çš„"æ¡ˆæƒ…"å…¨è²Œã€‚

```
æ—¥å¿—èšåˆçš„å¥½å¤„ï¼š
æ—¶é—´çº¿é‡å»ºï¼š
  10:15:23 WebæœåŠ¡å™¨ï¼šæ”¶åˆ°ç”¨æˆ·è¯·æ±‚
  10:15:24 åº”ç”¨æœåŠ¡ï¼šå¼€å§‹å¤„ç†ä¸šåŠ¡é€»è¾‘  
  10:15:26 æ•°æ®åº“ï¼šæ‰§è¡Œæ…¢æŸ¥è¯¢
  10:15:31 åº”ç”¨æœåŠ¡ï¼šæŸ¥è¯¢è¶…æ—¶
  10:15:31 WebæœåŠ¡å™¨ï¼šè¿”å›500é”™è¯¯

é—®é¢˜å®šä½ï¼š
  ä»ç”¨æˆ·æŠ•è¯‰ â†’ Webé”™è¯¯ â†’ åº”ç”¨è¶…æ—¶ â†’ æ•°æ®åº“æ…¢æŸ¥è¯¢
  æ•´ä¸ªé“¾è·¯ä¸€ç›®äº†ç„¶ï¼
```

**ç®€å•æ—¥å¿—èšåˆå®ç°ï¼š**
```bash
# æŒ‰æ—¶é—´æˆ³åˆå¹¶å¤šä¸ªæ—¥å¿—æ–‡ä»¶
combine_logs() {
    local timestamp="$1"
    echo "=== $timestamp æ—¶é—´æ®µç»¼åˆæ—¥å¿— ==="
    
    echo "--- WebæœåŠ¡å™¨æ—¥å¿— ---"
    grep "$timestamp" /var/log/nginx/access.log /var/log/nginx/error.log
    
    echo "--- åº”ç”¨æ—¥å¿— ---"  
    grep "$timestamp" /var/log/myapp/*.log
    
    echo "--- æ•°æ®åº“æ—¥å¿— ---"
    grep "$timestamp" /var/log/mysql/error.log
    
    echo "--- ç³»ç»Ÿæ—¥å¿— ---"
    grep "$timestamp" /var/log/messages
}

# ä½¿ç”¨ç¤ºä¾‹
combine_logs "17/Sep/2025:10:15"
```

---

## 3. ğŸ¯ é”™è¯¯æ¨¡å¼è¯†åˆ«æŠ€å·§


### 3.1 å¸¸è§é”™è¯¯æ¨¡å¼åˆ†ç±»


**ä»€ä¹ˆæ˜¯é”™è¯¯æ¨¡å¼ï¼Ÿ**
> é”™è¯¯æ¨¡å¼å°±åƒ"ç–¾ç—…ç—‡çŠ¶"ï¼Œç›¸ä¼¼çš„é—®é¢˜å¾€å¾€æœ‰ç›¸ä¼¼çš„"ç—‡çŠ¶è¡¨ç°"ã€‚æŒæ¡è¿™äº›æ¨¡å¼ï¼Œèƒ½å¿«é€Ÿå®šä½é—®é¢˜æ ¹æºã€‚

```
é”™è¯¯æ¨¡å¼åˆ†ç±»ï¼š
ğŸ”¸ èµ„æºç±»é”™è¯¯ï¼šå†…å­˜ä¸è¶³ã€ç£ç›˜æ»¡ã€CPUè¿‡è½½
ğŸ”¸ ç½‘ç»œç±»é”™è¯¯ï¼šè¿æ¥è¶…æ—¶ã€DNSè§£æå¤±è´¥ã€ç«¯å£ä¸å¯è¾¾
ğŸ”¸ æƒé™ç±»é”™è¯¯ï¼šæ–‡ä»¶æƒé™ã€ç”¨æˆ·æƒé™ã€SELinuxæ‹’ç»
ğŸ”¸ é…ç½®ç±»é”™è¯¯ï¼šè¯­æ³•é”™è¯¯ã€è·¯å¾„é”™è¯¯ã€å‚æ•°é”™è¯¯
ğŸ”¸ ä¾èµ–ç±»é”™è¯¯ï¼šåº“æ–‡ä»¶ç¼ºå¤±ã€ç‰ˆæœ¬å†²çªã€æœåŠ¡ä¸å¯ç”¨
```

### 3.2 ç³»ç»Ÿèµ„æºç±»é”™è¯¯è¯†åˆ«


#### ğŸ”¸ å†…å­˜ä¸è¶³é”™è¯¯æ¨¡å¼


**å…¸å‹é”™è¯¯ä¿¡æ¯ï¼š**
```
å†…æ ¸æ—¥å¿—ä¸­çš„è¡¨ç°ï¼š
kernel: Out of memory: Kill process 1234 (java) score 800 or sacrifice child
kernel: Killed process 1234 (java) total-vm:2097152kB, anon-rss:1048576kB

åº”ç”¨æ—¥å¿—ä¸­çš„è¡¨ç°ï¼š
java.lang.OutOfMemoryError: Java heap space
Cannot allocate memory for the buffer pool
```

**è¯†åˆ«æŠ€å·§ï¼š**
```bash
# å¿«é€Ÿè¯†åˆ«å†…å­˜ç›¸å…³é—®é¢˜
memory_issues() {
    echo "=== å†…å­˜ä¸è¶³å¾è±¡ ==="
    grep -i "out of memory\|oom\|killed process" /var/log/messages | tail -10
    
    echo "=== å†…å­˜åˆ†é…å¤±è´¥ ==="
    grep -i "cannot allocate\|allocation failed" /var/log/messages | tail -5
    
    echo "=== äº¤æ¢åˆ†åŒºå‹åŠ› ==="
    grep -i "swap" /var/log/messages | grep -i "warning\|error" | tail -5
}
```

#### ğŸ”¸ ç£ç›˜ç©ºé—´ä¸è¶³é”™è¯¯æ¨¡å¼


**è¯†åˆ«ç‰¹å¾ï¼š**
```
ç³»ç»Ÿæ—¥å¿—è¡¨ç°ï¼š
kernel: EXT4-fs error: No space left on device
rsyslogd: action 'action 17' suspended, next retry is Wed Sep 17 10:20:00 2025

åº”ç”¨æ—¥å¿—è¡¨ç°ï¼š
ERROR: Could not write to file: No space left on device
Database backup failed: insufficient disk space
```

**ç£ç›˜é—®é¢˜è¯Šæ–­ï¼š**
```bash
# ç£ç›˜é—®é¢˜å¿«é€Ÿæ£€æŸ¥
disk_check() {
    echo "=== ç£ç›˜ä½¿ç”¨æƒ…å†µ ==="
    df -h
    
    echo "=== æœ€å¤§çš„æ–‡ä»¶/ç›®å½• ==="
    du -sh /var/log/* | sort -rh | head -10
    
    echo "=== ç£ç›˜ç›¸å…³é”™è¯¯ ==="
    grep -i "no space\|disk full\|ext4.*error" /var/log/messages | tail -10
}
```

### 3.3 ç½‘ç»œç±»é”™è¯¯æ¨¡å¼è¯†åˆ«


#### ğŸ”¸ è¿æ¥è¶…æ—¶æ¨¡å¼


**å¸¸è§é”™è¯¯è¡¨ç°ï¼š**
```
åº”ç”¨å±‚è¶…æ—¶ï¼š
Connection timed out after 30000 milliseconds
HTTPConnectionPool: Read timed out (read timeout=30)
MySQL server has gone away

ç½‘ç»œå±‚è¶…æ—¶ï¼š
connect(): Connection timed out
No route to host
Network is unreachable
```

**ç½‘ç»œé—®é¢˜è¯Šæ–­è„šæœ¬æ¦‚å¿µï¼š**
```bash
# ç½‘ç»œè¿é€šæ€§æ£€æŸ¥
network_diagnosis() {
    local target_host="$1"
    local target_port="$2"
    
    echo "=== åŸºç¡€è¿é€šæ€§ ==="
    ping -c 3 "$target_host"
    
    echo "=== ç«¯å£å¯è¾¾æ€§ ==="
    timeout 5 telnet "$target_host" "$target_port" 2>&1
    
    echo "=== DNSè§£æ ==="
    nslookup "$target_host"
    
    echo "=== è·¯ç”±è·Ÿè¸ª ==="
    traceroute -n "$target_host" 2>/dev/null | head -10
}
```

#### ğŸ”¸ DNSè§£æé”™è¯¯æ¨¡å¼


**DNSé—®é¢˜è¯†åˆ«ï¼š**
```
é”™è¯¯ä¿¡æ¯ç‰¹å¾ï¼š
Name or service not known
Temporary failure in name resolution
DNS lookup failed

ç³»ç»Ÿæ—¥å¿—è¡¨ç°ï¼š
systemd-resolved[1234]: DNS query failed: Host not found
named[5678]: DNS query denied
```

### 3.4 é…ç½®é”™è¯¯æ¨¡å¼è¯†åˆ«


#### ğŸ”¸ é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯


**Apacheé…ç½®é”™è¯¯ç¤ºä¾‹ï¼š**
```
é”™è¯¯æ—¥å¿—å†…å®¹ï¼š
AH00526: Syntax error on line 45 of /etc/apache2/sites-enabled/default:
Invalid command 'DocumentRot', perhaps misspelled or defined by a module

Nginxé…ç½®é”™è¯¯ç¤ºä¾‹ï¼š
nginx: configuration file /etc/nginx/nginx.conf test failed
nginx: [emerg] unexpected ";" in /etc/nginx/nginx.conf:23
```

**é…ç½®é”™è¯¯å¿«é€Ÿå®šä½ï¼š**
```bash
# Apacheé…ç½®æ£€æŸ¥
apache_config_check() {
    echo "=== Apacheé…ç½®è¯­æ³•æ£€æŸ¥ ==="
    apache2ctl configtest 2>&1
    
    if [ $? -ne 0 ]; then
        echo "=== ç›¸å…³é”™è¯¯æ—¥å¿— ==="
        tail -20 /var/log/apache2/error.log | grep -i "syntax\|invalid"
    fi
}

# Nginxé…ç½®æ£€æŸ¥  
nginx_config_check() {
    echo "=== Nginxé…ç½®è¯­æ³•æ£€æŸ¥ ==="
    nginx -t 2>&1
    
    if [ $? -ne 0 ]; then
        echo "=== ç›¸å…³é”™è¯¯æ—¥å¿— ==="
        tail -20 /var/log/nginx/error.log
    fi
}
```

### 3.5 åº”ç”¨ç‰¹å®šé”™è¯¯æ¨¡å¼


#### ğŸ”¸ æ•°æ®åº“è¿æ¥é—®é¢˜æ¨¡å¼


**è¿æ¥æ± è€—å°½ï¼š**
```
é”™è¯¯ç‰¹å¾ï¼š
FATAL: remaining connection slots are reserved
Too many connections
Connection pool exhausted

è¯†åˆ«æ–¹æ³•ï¼š
grep -i "connection.*pool\|too many connections" /var/log/myapp/*.log
```

**æ•°æ®åº“æ­»é”æ¨¡å¼ï¼š**
```
MySQLæ­»é”ä¿¡æ¯ï¼š
Deadlock found when trying to get lock; try restarting transaction
Lock wait timeout exceeded; try restarting transaction

PostgreSQLæ­»é”ä¿¡æ¯ï¼š
ERROR: deadlock detected
ERROR: canceling statement due to lock timeout
```

---

## 4. â° æ—¶é—´æˆ³å…³è”åˆ†æ


### 4.1 æ—¶é—´æˆ³æ ¼å¼ç»Ÿä¸€åŒ–


**ä¸ºä»€ä¹ˆæ—¶é—´æˆ³å…³è”é‡è¦ï¼Ÿ**
> æ—¶é—´æˆ³å°±åƒ"æ¡ˆå‘æ—¶é—´"ï¼ŒæŠŠå„ä¸ª"è¯äºº"ï¼ˆä¸åŒç³»ç»Ÿï¼‰çš„"è¯è¯"ï¼ˆæ—¥å¿—ï¼‰æŒ‰æ—¶é—´ä¸²è”èµ·æ¥ï¼Œèƒ½è¿˜åŸäº‹ä»¶çš„å®Œæ•´è¿‡ç¨‹ã€‚

**å¸¸è§æ—¶é—´æˆ³æ ¼å¼ï¼š**
```
ç³»ç»Ÿæ—¥å¿—æ ¼å¼ï¼š
Sep 17 10:15:23           # ä¼ ç»Ÿsyslogæ ¼å¼
2025-09-17T10:15:23+08:00 # ISO 8601æ ¼å¼

WebæœåŠ¡å™¨æ ¼å¼ï¼š
17/Sep/2025:10:15:23 +0800  # Apacheæ ¼å¼
2025-09-17 10:15:23         # æ ‡å‡†æ ¼å¼

åº”ç”¨æ—¥å¿—æ ¼å¼ï¼š
2025-09-17 10:15:23.123     # æ¯«ç§’ç²¾åº¦
1726542923                  # Unixæ—¶é—´æˆ³
```

### 4.2 æ—¶é—´æˆ³æ ‡å‡†åŒ–å¤„ç†


**æ—¶é—´æ ¼å¼è½¬æ¢æŠ€å·§ï¼š**
```bash
# å°†å„ç§æ—¶é—´æ ¼å¼è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼
normalize_timestamp() {
    local log_line="$1"
    
    # Apacheæ ¼å¼è½¬æ¢
    if echo "$log_line" | grep -q "\[.*/.*/.*:.*:.*:.*\]"; then
        echo "$log_line" | sed 's/\[\([0-9]*\)\/\([A-Za-z]*\)\/\([0-9]*\):\([0-9:]*\) \([+-][0-9]*\)\]/[\3-\2-\1 \4 \5]/'
    fi
    
    # Unixæ—¶é—´æˆ³è½¬æ¢
    if echo "$log_line" | grep -q "^[0-9]\{10\}"; then
        timestamp=$(echo "$log_line" | awk '{print $1}')
        readable_time=$(date -d "@$timestamp" "+%Y-%m-%d %H:%M:%S")
        echo "$log_line" | sed "s/^$timestamp/$readable_time/"
    fi
}
```

### 4.3 è·¨ç³»ç»Ÿæ—¶é—´å…³è”åˆ†æ


**æ—¶é—´çª—å£åˆ†ææ–¹æ³•ï¼š**
```bash
# å®šä¹‰æ—¶é—´çª—å£å…³è”åˆ†æå‡½æ•°
time_window_analysis() {
    local start_time="$1"  # æ ¼å¼ï¼š2025-09-17 10:15:00
    local end_time="$2"    # æ ¼å¼ï¼š2025-09-17 10:20:00
    local window_file="/tmp/time_window_analysis.log"
    
    echo "=== æ—¶é—´çª—å£: $start_time åˆ° $end_time ===" > "$window_file"
    
    # WebæœåŠ¡å™¨æ—¥å¿—
    echo "--- WebæœåŠ¡å™¨äº‹ä»¶ ---" >> "$window_file"
    awk -v start="$start_time" -v end="$end_time" '
        BEGIN { 
            gsub(/-/, " ", start); gsub(/:/, " ", start)
            gsub(/-/, " ", end); gsub(/:/, " ", end)
        }
        {
            # æå–æ—¶é—´æˆ³å¹¶è½¬æ¢æ ¼å¼è¿›è¡Œæ¯”è¾ƒ
            if ($0 ~ /\[[0-9]{2}\/[A-Za-z]{3}\/[0-9]{4}:[0-9]{2}:[0-9]{2}:[0-9]{2}/) {
                # å¤„ç†Apacheæ ¼å¼æ—¶é—´æˆ³
                print $0
            }
        }
    ' /var/log/nginx/access.log >> "$window_file"
    
    # ç³»ç»Ÿæ—¥å¿—
    echo "--- ç³»ç»Ÿäº‹ä»¶ ---" >> "$window_file"
    journalctl --since "$start_time" --until "$end_time" --no-pager >> "$window_file"
    
    # åº”ç”¨æ—¥å¿—
    echo "--- åº”ç”¨äº‹ä»¶ ---" >> "$window_file"
    grep "2025-09-17 10:1[5-9]:" /var/log/myapp/*.log >> "$window_file" 2>/dev/null
    
    cat "$window_file"
}
```

### 4.4 æ—¶é—´åå·®é—®é¢˜å¤„ç†


**æ—¶é—´åŒæ­¥é—®é¢˜è¯†åˆ«ï¼š**
```bash
# æ£€æŸ¥ç³»ç»Ÿæ—¶é—´åŒæ­¥çŠ¶æ€
check_time_sync() {
    echo "=== ç³»ç»Ÿæ—¶é—´çŠ¶æ€ ==="
    timedatectl status
    
    echo "=== NTPåŒæ­¥çŠ¶æ€ ==="
    if command -v ntpq >/dev/null; then
        ntpq -p
    else
        systemctl status systemd-timesyncd
    fi
    
    echo "=== æ—¶åŒºè®¾ç½® ==="
    ls -la /etc/localtime
    
    echo "=== æ—¶é—´ç›¸å…³æ—¥å¿— ==="
    grep -i "time\|ntp\|clock" /var/log/messages | tail -10
}
```

**ä¸åŒæ—¶åŒºæ—¥å¿—å¤„ç†ï¼š**
```bash
# å¤„ç†ä¸åŒæ—¶åŒºçš„æ—¥å¿—
convert_timezone() {
    local log_file="$1"
    local target_tz="Asia/Shanghai"  # ç›®æ ‡æ—¶åŒº
    
    # å‡è®¾åŸæ—¥å¿—æ˜¯UTCæ—¶é—´ï¼Œè½¬æ¢ä¸ºæœ¬åœ°æ—¶åŒº
    while IFS= read -r line; do
        if echo "$line" | grep -q "2025-.*T.*Z"; then
            utc_time=$(echo "$line" | grep -o "2025-[0-9-]*T[0-9:]*Z")
            local_time=$(TZ="$target_tz" date -d "$utc_time" "+%Y-%m-%d %H:%M:%S %Z")
            echo "$line" | sed "s/$utc_time/$local_time/"
        else
            echo "$line"
        fi
    done < "$log_file"
}
```

### 4.5 æ—¶é—´çº¿é‡å»ºå®æˆ˜


**å®Œæ•´äº‹ä»¶æ—¶é—´çº¿æ„å»ºï¼š**
```bash
# äº‹ä»¶æ—¶é—´çº¿é‡å»º
rebuild_timeline() {
    local incident_time="$1"  # äº‹ä»¶å‘ç”Ÿæ—¶é—´
    local before_minutes=10   # äº‹ä»¶å‰10åˆ†é’Ÿ
    local after_minutes=10    # äº‹ä»¶å10åˆ†é’Ÿ
    
    # è®¡ç®—æ—¶é—´èŒƒå›´
    start_time=$(date -d "$incident_time - $before_minutes minutes" "+%Y-%m-%d %H:%M:%S")
    end_time=$(date -d "$incident_time + $after_minutes minutes" "+%Y-%m-%d %H:%M:%S")
    
    echo "=== äº‹ä»¶æ—¶é—´çº¿é‡å»º ==="
    echo "ä¸­å¿ƒæ—¶é—´: $incident_time"
    echo "åˆ†æèŒƒå›´: $start_time è‡³ $end_time"
    echo
    
    # æ”¶é›†å„ç³»ç»Ÿæ—¥å¿—å¹¶æŒ‰æ—¶é—´æ’åº
    {
        # ç³»ç»Ÿæ—¥å¿—
        journalctl --since "$start_time" --until "$end_time" --output=short-precise | \
        sed 's/^/[SYSTEM] /'
        
        # WebæœåŠ¡å™¨æ—¥å¿—ï¼ˆå‡è®¾å·²æ ‡å‡†åŒ–æ—¶é—´æ ¼å¼ï¼‰
        grep "2025-09-17 1[0-9]:" /var/log/nginx/access.log | \
        awk -v start="$start_time" -v end="$end_time" '{
            if ($0 >= start && $0 <= end) print "[WEB] " $0
        }'
        
        # æ•°æ®åº“æ—¥å¿—
        grep "2025-09-17 1[0-9]:" /var/log/mysql/error.log | \
        awk -v start="$start_time" -v end="$end_time" '{
            if ($0 >= start && $0 <= end) print "[DB] " $0
        }'
        
    } | sort -k3,4  # æŒ‰æ—¶é—´æˆ³æ’åº
}
```

**æ—¶é—´å…³è”åˆ†æç¤ºä¾‹ç»“æœï¼š**
```
=== äº‹ä»¶æ—¶é—´çº¿é‡å»º ===
2025-09-17 10:12:15 [WEB] æ­£å¸¸è®¿é—®è¯·æ±‚å¢åŠ 
2025-09-17 10:14:32 [SYSTEM] å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°85%
2025-09-17 10:15:23 [DB] æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡90%
2025-09-17 10:15:45 [WEB] å¼€å§‹å‡ºç°5xxé”™è¯¯
2025-09-17 10:16:12 [SYSTEM] Out of memory killeræ¿€æ´»
2025-09-17 10:16:13 [DB] æ•°æ®åº“è¿›ç¨‹è¢«ç»ˆæ­¢
2025-09-17 10:16:15 [WEB] å¤§é‡503é”™è¯¯

åˆ†æç»“è®ºï¼šæµé‡æ¿€å¢ â†’ å†…å­˜ä¸è¶³ â†’ æ•°æ®åº“è¿›ç¨‹è¢«æ€ â†’ æœåŠ¡ä¸å¯ç”¨
```

---

## 5. ğŸ“Š æ—¥å¿—çº§åˆ«ç­›é€‰æ–¹æ³•


### 5.1 æ—¥å¿—çº§åˆ«ç³»ç»Ÿç†è§£


**ä»€ä¹ˆæ˜¯æ—¥å¿—çº§åˆ«ï¼Ÿ**
> æ—¥å¿—çº§åˆ«å°±åƒ"è­¦æŠ¥çº§åˆ«"ï¼Œä»"ä¸€èˆ¬æé†’"åˆ°"ç´§æ€¥è­¦æŠ¥"ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿè¯†åˆ«é—®é¢˜çš„ä¸¥é‡ç¨‹åº¦ã€‚

**æ ‡å‡†æ—¥å¿—çº§åˆ«ï¼ˆæŒ‰ä¸¥é‡ç¨‹åº¦æ’åºï¼‰ï¼š**
```
0 - EMERGENCY  ğŸš¨ ç³»ç»Ÿä¸å¯ç”¨ï¼Œéœ€ç«‹å³å¤„ç†
1 - ALERT      ğŸ”¥ å¿…é¡»ç«‹å³é‡‡å–è¡ŒåŠ¨
2 - CRITICAL   â— å…³é”®æ¡ä»¶ï¼Œä¸¥é‡é—®é¢˜
3 - ERROR      âŒ é”™è¯¯æ¡ä»¶ï¼Œéœ€è¦å…³æ³¨
4 - WARNING    âš ï¸  è­¦å‘Šæ¡ä»¶ï¼Œæ½œåœ¨é—®é¢˜
5 - NOTICE     ğŸ“¢ æ­£å¸¸ä½†é‡è¦çš„æ¡ä»¶
6 - INFO       â„¹ï¸  ä¸€èˆ¬ä¿¡æ¯æ¶ˆæ¯
7 - DEBUG      ğŸ” è°ƒè¯•ä¿¡æ¯ï¼Œè¯¦ç»†è¯Šæ–­
```

### 5.2 ç³»ç»Ÿæ—¥å¿—çº§åˆ«ç­›é€‰


#### ğŸ”¸ rsyslogçº§åˆ«é…ç½®ä¸ç­›é€‰


**rsyslogé…ç½®ç¤ºä¾‹ï¼š**
```bash
# /etc/rsyslog.conf é…ç½®è§£è¯»
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
# å«ä¹‰ï¼šæ‰€æœ‰è®¾æ–½çš„infoçº§åˆ«ä»¥ä¸Šï¼ˆåŒ…æ‹¬infoï¼‰ï¼Œæ’é™¤mailã€authprivã€cron

authpriv.*                                  /var/log/secure  
# å«ä¹‰ï¼šauthprivè®¾æ–½çš„æ‰€æœ‰çº§åˆ«

*.emerg                                     *
# å«ä¹‰ï¼šæ‰€æœ‰emergencyçº§åˆ«æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰ç™»å½•ç”¨æˆ·
```

**æŒ‰çº§åˆ«ç­›é€‰æ—¥å¿—ï¼š**
```bash
# ç­›é€‰ä¸¥é‡é”™è¯¯ï¼ˆCRITICALã€ALERTã€EMERGENCYï¼‰
filter_critical() {
    echo "=== ä¸¥é‡é”™è¯¯ç­›é€‰ ==="
    grep -E "(CRITICAL|ALERT|EMERGENCY|emerg|alert|crit)" /var/log/messages
}

# ç­›é€‰é”™è¯¯å’Œè­¦å‘Š
filter_errors_warnings() {
    echo "=== é”™è¯¯å’Œè­¦å‘Šç­›é€‰ ==="
    grep -iE "(error|err|warning|warn|failed|failure)" /var/log/messages | tail -20
}

# ç­›é€‰ä¿¡æ¯çº§åˆ«
filter_info() {
    echo "=== ä¿¡æ¯çº§åˆ«ç­›é€‰ ==="
    grep -iE "(info|notice|started|stopped|loaded)" /var/log/messages | tail -10
}
```

#### ğŸ”¸ journalctlçº§åˆ«ç­›é€‰


**ä½¿ç”¨journalctlæŒ‰çº§åˆ«æŸ¥çœ‹ï¼š**
```bash
# åªæ˜¾ç¤ºé”™è¯¯çº§åˆ«ä»¥ä¸Šçš„æ¶ˆæ¯
journalctl -p err

# æ˜¾ç¤ºè­¦å‘Šçº§åˆ«ä»¥ä¸Šçš„æ¶ˆæ¯  
journalctl -p warning

# æ˜¾ç¤ºç‰¹å®šçº§åˆ«çš„æ¶ˆæ¯
journalctl -p debug

# ç»„åˆæ¡ä»¶ç­›é€‰
journalctl -p err --since "1 hour ago" -u nginx.service
```

**journalctlçº§åˆ«ç­›é€‰é«˜çº§ç”¨æ³•ï¼š**
```bash
# å¤šçº§åˆ«ç»„åˆæŸ¥è¯¢
view_priority_levels() {
    echo "=== EMERGENCY + ALERTçº§åˆ« ==="
    journalctl -p alert --no-pager -n 5
    
    echo "=== CRITICAL + ERRORçº§åˆ« ==="  
    journalctl -p err --no-pager -n 10
    
    echo "=== WARNINGçº§åˆ« ==="
    journalctl -p warning --no-pager -n 15
    
    echo "=== ç»Ÿè®¡å„çº§åˆ«æ•°é‡ ==="
    for level in emerg alert crit err warning notice info debug; do
        count=$(journalctl -p $level --no-pager | wc -l)
        echo "$level: $count æ¡"
    done
}
```

### 5.3 åº”ç”¨æ—¥å¿—çº§åˆ«ç®¡ç†


#### ğŸ”¸ å¸¸è§åº”ç”¨æ—¥å¿—çº§åˆ«


**Apacheæ—¥å¿—çº§åˆ«æ§åˆ¶ï¼š**
```apache
# httpd.conf æˆ– apache2.conf
LogLevel warn                    # è®¾ç½®å…¨å±€æ—¥å¿—çº§åˆ«

# ç‰¹å®šæ¨¡å—çº§åˆ«è®¾ç½®
LogLevel rewrite:trace3          # é‡å†™æ¨¡å—è¯¦ç»†è°ƒè¯•
LogLevel ssl:info               # SSLæ¨¡å—ä¿¡æ¯çº§åˆ«
```

**Nginxæ—¥å¿—çº§åˆ«è®¾ç½®ï¼š**
```nginx
# nginx.conf
error_log /var/log/nginx/error.log warn;   # è­¦å‘Šçº§åˆ«ä»¥ä¸Š
error_log /var/log/nginx/debug.log debug;  # è°ƒè¯•çº§åˆ«ï¼ˆéœ€ç¼–è¯‘æ”¯æŒï¼‰

# å¯ç”¨çº§åˆ«ï¼šdebug, info, notice, warn, error, crit, alert, emerg
```

#### ğŸ”¸ è‡ªå®šä¹‰åº”ç”¨æ—¥å¿—çº§åˆ«ç­›é€‰


**Pythonåº”ç”¨æ—¥å¿—çº§åˆ«ç­›é€‰ï¼š**
```bash
# Python loggingæ¨¡å—çš„çº§åˆ«ç­›é€‰
python_log_filter() {
    local log_file="/var/log/myapp/app.log"
    
    echo "=== CRITICALé”™è¯¯ ==="
    grep "CRITICAL" "$log_file" | tail -5
    
    echo "=== ERRORé”™è¯¯ ==="
    grep "ERROR" "$log_file" | tail -10
    
    echo "=== WARNINGè­¦å‘Š ==="
    grep "WARNING" "$log_file" | tail -15
    
    echo "=== æŒ‰çº§åˆ«ç»Ÿè®¡ ==="
    echo "CRITICAL: $(grep -c "CRITICAL" "$log_file")"
    echo "ERROR:    $(grep -c "ERROR" "$log_file")"
    echo "WARNING:  $(grep -c "WARNING" "$log_file")"
    echo "INFO:     $(grep -c "INFO" "$log_file")"
    echo "DEBUG:    $(grep -c "DEBUG" "$log_file")"
}
```

### 5.4 çº§åˆ«ç­›é€‰è‡ªåŠ¨åŒ–è„šæœ¬


**æ™ºèƒ½æ—¥å¿—çº§åˆ«åˆ†æï¼š**
```bash
#!/bin/bash
# æ™ºèƒ½æ—¥å¿—çº§åˆ«åˆ†æè„šæœ¬

analyze_log_levels() {
    local log_file="$1"
    local hours_back="${2:-1}"  # é»˜è®¤åˆ†ææœ€è¿‘1å°æ—¶
    
    echo "=== æ—¥å¿—çº§åˆ«åˆ†ææŠ¥å‘Š ==="
    echo "æ–‡ä»¶: $log_file"
    echo "æ—¶é—´èŒƒå›´: æœ€è¿‘ $hours_back å°æ—¶"
    echo "åˆ†ææ—¶é—´: $(date)"
    echo
    
    # æå–æœ€è¿‘Nå°æ—¶çš„æ—¥å¿—
    recent_logs="/tmp/recent_logs_$$"
    since_time=$(date -d "$hours_back hours ago" "+%Y-%m-%d %H:%M:%S")
    
    # æ ¹æ®ä¸åŒçš„æ—¶é—´æ ¼å¼æå–æ—¥å¿—
    if [[ "$log_file" =~ syslog|messages ]]; then
        # ç³»ç»Ÿæ—¥å¿—æ ¼å¼
        journalctl --since "$since_time" --no-pager > "$recent_logs"
    else
        # åº”ç”¨æ—¥å¿—æ ¼å¼ï¼ˆå‡è®¾YYYY-MM-DD HH:MM:SSæ ¼å¼ï¼‰
        awk -v since="$since_time" '$0 >= since' "$log_file" > "$recent_logs"
    fi
    
    echo "=== çº§åˆ«ç»Ÿè®¡ ==="
    printf "%-12s %8s %8s\n" "çº§åˆ«" "æ•°é‡" "å æ¯”"
    echo "------------------------"
    
    total_lines=$(wc -l < "$recent_logs")
    
    for level in EMERGENCY ALERT CRITICAL ERROR WARNING NOTICE INFO DEBUG; do
        count=$(grep -ic "$level\|${level,,}" "$recent_logs" || echo "0")
        percentage=$(( count * 100 / (total_lines > 0 ? total_lines : 1) ))
        printf "%-12s %8d %7d%%\n" "$level" "$count" "$percentage"
    done
    
    echo
    echo "=== å¼‚å¸¸è¶‹åŠ¿åˆ†æ ==="
    error_count=$(grep -icE "(error|critical|emergency|alert)" "$recent_logs")
    warning_count=$(grep -ic "warning" "$recent_logs")
    
    if [ "$error_count" -gt 10 ]; then
        echo "ğŸ”¥ ä¸¥é‡å‘Šè­¦ï¼šæ£€æµ‹åˆ° $error_count ä¸ªä¸¥é‡é”™è¯¯ï¼Œéœ€è¦ç«‹å³å…³æ³¨ï¼"
    elif [ "$error_count" -gt 5 ]; then
        echo "âš ï¸  ä¸­ç­‰å‘Šè­¦ï¼šæ£€æµ‹åˆ° $error_count ä¸ªé”™è¯¯ï¼Œå»ºè®®æ£€æŸ¥"
    elif [ "$warning_count" -gt 20 ]; then
        echo "ğŸ’¡ æé†’ï¼šæ£€æµ‹åˆ° $warning_count ä¸ªè­¦å‘Šï¼Œå¯èƒ½éœ€è¦å…³æ³¨"
    else
        echo "âœ… çŠ¶æ€è‰¯å¥½ï¼šé”™è¯¯æ•°é‡åœ¨æ­£å¸¸èŒƒå›´å†…"
    fi
    
    echo
    echo "=== æœ€æ–°çš„ä¸¥é‡é—®é¢˜ ==="
    grep -iE "(critical|emergency|alert|error)" "$recent_logs" | tail -5
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f "$recent_logs"
}

# ä½¿ç”¨ç¤ºä¾‹
# analyze_log_levels /var/log/messages 2
# analyze_log_levels /var/log/nginx/error.log 1
```

---

## 6. ğŸ” å…³é”®å­—æœç´¢ä¸è¿‡æ»¤


### 6.1 åŸºç¡€å…³é”®å­—æœç´¢æŠ€å·§


**ä»€ä¹ˆæ˜¯å…³é”®å­—æœç´¢ï¼Ÿ**
> å…³é”®å­—æœç´¢å°±åƒåœ¨å›¾ä¹¦é¦†æ‰¾ä¹¦ï¼Œä½ å‘Šè¯‰ç®¡ç†å‘˜å‡ ä¸ªå…³é”®è¯ï¼Œä»–å°±èƒ½å¸®ä½ æ‰¾åˆ°ç›¸å…³çš„æ‰€æœ‰ä¹¦ç±ã€‚åœ¨æ—¥å¿—åˆ†æä¸­ï¼Œå…³é”®å­—èƒ½å¸®æˆ‘ä»¬å¿«é€Ÿå®šä½é—®é¢˜ã€‚

**grepåŸºç¡€ç”¨æ³•æå‡ï¼š**
```bash
# åŸºç¡€æœç´¢ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
grep -i "error" /var/log/messages

# æ˜¾ç¤ºåŒ¹é…è¡Œçš„ä¸Šä¸‹æ–‡ï¼ˆå‰å3è¡Œï¼‰
grep -i -C 3 "database connection failed" /var/log/myapp.log

# é€’å½’æœç´¢ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
grep -r "memory" /var/log/

# æ˜¾ç¤ºè¡Œå·å’Œæ–‡ä»¶å
grep -n -H "404" /var/log/nginx/access.log

# åå‘æœç´¢ï¼ˆæ˜¾ç¤ºä¸åŒ…å«å…³é”®å­—çš„è¡Œï¼‰
grep -v "INFO" /var/log/application.log
```

### 6.2 æ­£åˆ™è¡¨è¾¾å¼é«˜çº§æœç´¢


**å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼š**
```bash
# æœç´¢IPåœ°å€
grep -E "([0-9]{1,3}\.){3}[0-9]{1,3}" /var/log/nginx/access.log

# æœç´¢æ—¶é—´æˆ³èŒƒå›´ï¼ˆ10:00-11:59ï¼‰
grep -E "1[0-1]:[0-9]{2}:[0-9]{2}" /var/log/messages

# æœç´¢HTTPçŠ¶æ€ç ï¼ˆ4xxå’Œ5xxé”™è¯¯ï¼‰
grep -E '" [45][0-9]{2} ' /var/log/apache2/access.log

# æœç´¢é‚®ç®±åœ°å€
grep -E "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" /var/log/mail.log

# æœç´¢ç‰¹å®šè¿›ç¨‹IDæ¨¡å¼
grep -E "pid [0-9]{3,5}" /var/log/messages
```

**å¤åˆæ¡ä»¶æœç´¢ï¼š**
```bash
# ANDæ¡ä»¶ï¼šåŒæ—¶åŒ…å«ä¸¤ä¸ªå…³é”®å­—
grep "database" /var/log/app.log | grep "timeout"

# ORæ¡ä»¶ï¼šåŒ…å«ä»»æ„ä¸€ä¸ªå…³é”®å­—
grep -E "(database|connection|timeout)" /var/log/app.log

# NOTæ¡ä»¶ï¼šæ’é™¤ç‰¹å®šå†…å®¹
grep "error" /var/log/app.log | grep -v "connection reset"

# å¤æ‚ç»„åˆæ¡ä»¶
grep -E "(error|critical)" /var/log/messages | grep -v "test" | grep -i "mysql"
```

### 6.3 é«˜æ•ˆæ—¥å¿—è¿‡æ»¤ç­–ç•¥


#### ğŸ”¸ æ—¶é—´èŒƒå›´è¿‡æ»¤


**åŸºäºæ—¶é—´æˆ³çš„è¿‡æ»¤ï¼š**
```bash
# æå–ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
time_filter() {
    local log_file="$1"
    local start_hour="$2"    # æ ¼å¼ï¼š10 (è¡¨ç¤º10ç‚¹)
    local end_hour="$3"      # æ ¼å¼ï¼š12 (è¡¨ç¤º12ç‚¹)
    
    echo "=== $start_hour:00 åˆ° $end_hour:59 æ—¶é—´æ®µæ—¥å¿— ==="
    
    # é’ˆå¯¹ä¸åŒæ—¶é—´æ ¼å¼çš„å¤„ç†
    if grep -q "^[A-Z][a-z][a-z] [0-9][0-9] [0-9][0-9]:" "$log_file"; then
        # syslogæ ¼å¼ï¼šSep 17 10:15:23
        sed -n "/^[A-Z][a-z][a-z] [0-9][0-9] $start_hour:/,/^[A-Z][a-z][a-z] [0-9][0-9] $end_hour:[5-9][0-9]:/p" "$log_file"
    elif grep -q "^2025-" "$log_file"; then
        # ISOæ ¼å¼ï¼š2025-09-17 10:15:23
        awk -v start=$start_hour -v end=$end_hour '
            {
                if (match($0, /[0-9]{4}-[0-9]{2}-[0-9]{2} ([0-9]{2}):/, arr)) {
                    hour = arr[1]
                    if (hour >= start && hour <= end) print $0
                }
            }
        ' "$log_file"
    fi
}
```

#### ğŸ”¸ å†…å®¹ä¼˜å…ˆçº§è¿‡æ»¤


**æŒ‰ä¸¥é‡ç¨‹åº¦ç­›é€‰ï¼š**
```bash
# ä¸¥é‡é”™è¯¯ä¼˜å…ˆç­›é€‰
priority_filter() {
    local log_file="$1"
    
    echo "=== ğŸš¨ æœ€é«˜ä¼˜å…ˆçº§ï¼šç³»ç»Ÿå±é™© ==="
    grep -iE "(emergency|panic|fatal|kernel panic|segmentation fault)" "$log_file"
    
    echo "=== ğŸ”¥ é«˜ä¼˜å…ˆçº§ï¼šä¸¥é‡é”™è¯¯ ==="  
    grep -iE "(critical|alert|severe|corruption|failed to start)" "$log_file"
    
    echo "=== âš ï¸  ä¸­ä¼˜å…ˆçº§ï¼šä¸€èˆ¬é”™è¯¯ ==="
    grep -iE "(error|fail|denied|refused|timeout)" "$log_file" | head -20
    
    echo "=== ğŸ’¡ ä½ä¼˜å…ˆçº§ï¼šè­¦å‘Šä¿¡æ¯ ==="
    grep -iE "(warning|warn|deprecated|retry)" "$log_file" | head -10
}
```

### 6.4 å¤šæ–‡ä»¶å…³è”æœç´¢


**è·¨æ–‡ä»¶å…³é”®å­—å…³è”ï¼š**
```bash
# å¤šæ–‡ä»¶å…³è”æœç´¢
cross_file_search() {
    local keyword="$1"
    local timeframe="$2"  # å¦‚ï¼š10:15
    
    echo "=== å…³é”®å­— '$keyword' è·¨æ–‡ä»¶æœç´¢ ==="
    echo "æ—¶é—´æ¡†æ¶ï¼š$timeframe"
    echo
    
    # æœç´¢ç³»ç»Ÿæ—¥å¿—
    if grep -q "$timeframe.*$keyword" /var/log/messages 2>/dev/null; then
        echo "--- ç³»ç»Ÿæ—¥å¿— (/var/log/messages) ---"
        grep "$timeframe.*$keyword" /var/log/messages
        echo
    fi
    
    # æœç´¢è®¤è¯æ—¥å¿—
    if grep -q "$timeframe.*$keyword" /var/log/auth.log 2>/dev/null; then
        echo "--- è®¤è¯æ—¥å¿— (/var/log/auth.log) ---"
        grep "$timeframe.*$keyword" /var/log/auth.log
        echo
    fi
    
    # æœç´¢WebæœåŠ¡å™¨æ—¥å¿—
    if ls /var/log/nginx/*.log >/dev/null 2>&1; then
        echo "--- Nginxæ—¥å¿— ---"
        grep -h "$keyword" /var/log/nginx/*.log | grep "$timeframe" 2>/dev/null
        echo
    fi
    
    # æœç´¢åº”ç”¨æ—¥å¿—ç›®å½•
    if [ -d "/var/log/app" ]; then
        echo "--- åº”ç”¨æ—¥å¿— ---"
        find /var/log/app -name "*.log" -exec grep -l "$keyword" {} \; | while read file; do
            echo "æ–‡ä»¶ï¼š$file"
            grep "$timeframe.*$keyword" "$file" 2>/dev/null
            echo
        done
    fi
}
```

### 6.5 æ™ºèƒ½å…³é”®å­—å»ºè®®ç³»ç»Ÿ


**åŸºäºä¸Šä¸‹æ–‡çš„å…³é”®å­—æŒ–æ˜ï¼š**
```bash
# æ™ºèƒ½å…³é”®å­—åˆ†æ
intelligent_keyword_analysis() {
    local log_file="$1"
    local primary_keyword="$2"  # ä¸»è¦å…³é”®å­—ï¼Œå¦‚ "error"
    
    echo "=== åŸºäº '$primary_keyword' çš„å…³è”å…³é”®å­—åˆ†æ ==="
    
    # æå–åŒ…å«ä¸»è¦å…³é”®å­—çš„è¡Œ
    temp_file="/tmp/keyword_analysis_$$"
    grep -i "$primary_keyword" "$log_file" > "$temp_file"
    
    echo "--- é«˜é¢‘å…³è”è¯æ±‡ TOP 10 ---"
    # åˆ†æä¸ä¸»å…³é”®å­—å…±ç°çš„é«˜é¢‘è¯æ±‡
    cat "$temp_file" | \
    tr ' ' '\n' | \
    tr '[:upper:]' '[:lower:]' | \
    grep -v "^$primary_keyword$" | \
    grep -E '^[a-z]{3,}$' | \
    sort | uniq -c | sort -rn | head -10 | \
    awk '{printf "%-15s %dæ¬¡\n", $2, $1}'
    
    echo
    echo "--- å¸¸è§é”™è¯¯ç±»å‹æ¨¡å¼ ---"
    # åˆ†æé”™è¯¯ç±»å‹æ¨¡å¼
    grep -ioE "(connection.*error|timeout.*error|permission.*denied|file.*not.*found|out.*of.*memory)" "$temp_file" | \
    sort | uniq -c | sort -rn | head -5 | \
    awk '{$1=""; printf "%-30s %dæ¬¡\n", $0, $1}'
    
    echo  
    echo "--- æ—¶é—´æ®µåˆ†å¸ƒåˆ†æ ---"
    # åˆ†æé—®é¢˜å‘ç”Ÿçš„æ—¶é—´æ®µåˆ†å¸ƒ
    if grep -q "^[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\} [0-9]\{2\}:" "$temp_file"; then
        # ISOæ—¶é—´æ ¼å¼
        awk '{
            if (match($0, /[0-9]{4}-[0-9]{2}-[0-9]{2} ([0-9]{2}):/, arr)) {
                hours[arr[1]]++
            }
        } END {
            for (h in hours) printf "%02d:xx æ—¶æ®µ: %dæ¬¡\n", h, hours[h]
        }' "$temp_file" | sort
    fi
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f "$temp_file"
}
```

**å»ºè®®æœç´¢å…³é”®å­—åº“ï¼š**
```bash
# é¢„å®šä¹‰å…³é”®å­—åˆ†ç±»
get_suggested_keywords() {
    local problem_type="$1"
    
    case "$problem_type" in
        "performance")
            echo "æ€§èƒ½ç›¸å…³å…³é”®å­—ï¼š"
            echo "slow, timeout, high, load, cpu, memory, disk, response"
            ;;
        "security")
            echo "å®‰å…¨ç›¸å…³å…³é”®å­—ï¼š"
            echo "failed, denied, unauthorized, attack, intrusion, blocked"
            ;;
        "network")  
            echo "ç½‘ç»œç›¸å…³å…³é”®å­—ï¼š"
            echo "connection, unreachable, timeout, dns, resolve, port"
            ;;
        "database")
            echo "æ•°æ®åº“ç›¸å…³å…³é”®å­—ï¼š"
            echo "deadlock, connection, pool, query, slow, timeout, lock"
            ;;
        *)
            echo "é€šç”¨é—®é¢˜å…³é”®å­—ï¼š"
            echo "error, fail, critical, warning, exception, crash"
            ;;
    esac
}

# ä½¿ç”¨ç¤ºä¾‹ï¼š
# get_suggested_keywords "performance"
# intelligent_keyword_analysis /var/log/messages "error"
# cross_file_search "database" "10:15"
```

---

## 7. ğŸ› ï¸ æ—¥å¿—èšåˆåˆ†æå·¥å…·ä½¿ç”¨


### 7.1 æ—¥å¿—èšåˆçš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ—¥å¿—èšåˆï¼Ÿ**
> æ—¥å¿—èšåˆå°±åƒ"ä¿¡æ¯æ±‡æ€»å‘˜"ï¼ŒæŠŠæ•£è½åœ¨å„ä¸ªç³»ç»Ÿçš„æ—¥å¿—ä¿¡æ¯æ”¶é›†åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œç»Ÿä¸€åˆ†æå¤„ç†ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¸ç”¨è·‘å„ä¸ªéƒ¨é—¨é—®æƒ…å†µï¼Œæ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ä¸€ä¸ªåŠå…¬å®¤é‡Œã€‚

**æ—¥å¿—èšåˆçš„ä»·å€¼ï¼š**
```
åˆ†æ•£å¼æ—¥å¿—çš„é—®é¢˜ï¼š
æœåŠ¡å™¨Aï¼šWebæœåŠ¡å™¨æ—¥å¿—
æœåŠ¡å™¨Bï¼šæ•°æ®åº“æ—¥å¿—  
æœåŠ¡å™¨Cï¼šåº”ç”¨æœåŠ¡æ—¥å¿—
é—®é¢˜ï¼šéœ€è¦ç™»å½•å¤šå°æœåŠ¡å™¨æŸ¥çœ‹ï¼Œå…³è”åˆ†æå›°éš¾

èšåˆåçš„ä¼˜åŠ¿ï¼š
ç»Ÿä¸€å…¥å£ï¼šä¸€ä¸ªç•Œé¢æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
å…³è”åˆ†æï¼šè·¨ç³»ç»Ÿäº‹ä»¶å…³è”
å®æ—¶ç›‘æ§ï¼šé›†ä¸­å¼å‘Šè­¦
å†å²åˆ†æï¼šç»Ÿä¸€å­˜å‚¨å’ŒæŸ¥è¯¢
```

### 7.2 ELK StackåŸºç¡€ä½¿ç”¨


#### ğŸ”¸ Elasticsearchæ—¥å¿—å­˜å‚¨ä¸æœç´¢


**ElasticsearchåŸºæœ¬æ¦‚å¿µï¼š**
```bash
# æŸ¥çœ‹Elasticsearché›†ç¾¤çŠ¶æ€
curl -X GET "localhost:9200/_cluster/health?pretty"

# æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•
curl -X GET "localhost:9200/_cat/indices?v"

# æœç´¢æ—¥å¿—ç¤ºä¾‹
curl -X GET "localhost:9200/logstash-*/_search?pretty" -H 'Content-Type: application/json' -d'
{
  "query": {
    "bool": {
      "must": [
        {"match": {"level": "ERROR"}},
        {"range": {"timestamp": {"gte": "now-1h"}}}
      ]
    }
  },
  "sort": [{"timestamp": {"order": "desc"}}],
  "size": 10
}'
```

#### ğŸ”¸ Logstashæ—¥å¿—å¤„ç†é…ç½®


**åŸºç¡€Logstashé…ç½®ç¤ºä¾‹ï¼š**
```ruby
# /etc/logstash/conf.d/syslog.conf
input {
  file {
    path => "/var/log/messages"
    type => "syslog"
    start_position => "beginning"
  }
  
  file {
    path => "/var/log/nginx/access.log"  
    type => "nginx_access"
    start_position => "beginning"
  }
}

filter {
  if [type] == "syslog" {
    grok {
      match => { 
        "message" => "%{SYSLOGTIMESTAMP:timestamp} %{IPORHOST:host} %{WORD:program}(?:\[%{POSINT:pid}\])?: %{GREEDYDATA:message}" 
      }
    }
  }
  
  if [type] == "nginx_access" {
    grok {
      match => { 
        "message" => "%{NGINXACCESS}" 
      }
    }
  }
  
  date {
    match => [ "timestamp", "MMM dd HH:mm:ss", "dd/MMM/yyyy:HH:mm:ss Z" ]
  }
}

output {
  elasticsearch {
    hosts => ["localhost:9200"]
    index => "logs-%{+YYYY.MM.dd}"
  }
}
```

#### ğŸ”¸ Kibanaå¯è§†åŒ–åˆ†æ


**Kibanaå¸¸ç”¨æœç´¢æŸ¥è¯¢ï¼š**
```
æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼š
timestamp:[now-1h TO now] AND level:ERROR

å¤åˆæ¡ä»¶æŸ¥è¯¢ï¼š
host:web01 AND (level:ERROR OR level:CRITICAL)

é€šé…ç¬¦æŸ¥è¯¢ï¼š  
message:*database*timeout*

æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢ï¼š
host:/web[0-9]+/ AND level:ERROR
```

### 7.3 è½»é‡çº§å·¥å…·ä½¿ç”¨


#### ğŸ”¸ rsyslogé›†ä¸­åŒ–é…ç½®


**rsyslogæœåŠ¡ç«¯é…ç½®ï¼š**
```bash
# /etc/rsyslog.conf æœåŠ¡ç«¯é…ç½®
# å¯ç”¨UDPæ¥æ”¶
$ModLoad imudp
$UDPServerRun 514
$UDPServerAddress 0.0.0.0

# å¯ç”¨TCPæ¥æ”¶ï¼ˆæ›´å¯é ï¼‰
$ModLoad imtcp  
$InputTCPServerRun 514

# æ ¹æ®ä¸»æœºååˆ†åˆ«å­˜å‚¨
$template RemoteHost,"/var/log/remote/%HOSTNAME%/%syslogtag%.log"
*.* ?RemoteHost
```

**rsyslogå®¢æˆ·ç«¯é…ç½®ï¼š**
```bash
# /etc/rsyslog.conf å®¢æˆ·ç«¯é…ç½®  
# å‘é€æ‰€æœ‰æ—¥å¿—åˆ°ä¸­å¤®æœåŠ¡å™¨
*.* $$192.168.1.100:514    # TCPæ–¹å¼
*.* @192.168.1.100:514     # UDPæ–¹å¼

# åªå‘é€é‡è¦æ—¥å¿—
*.crit $$192.168.1.100:514
```

#### ğŸ”¸ journalctlè¿œç¨‹è½¬å‘


**systemd-journal-remoteé…ç½®ï¼š**
```bash
# å®‰è£…journalè¿œç¨‹ç»„ä»¶
sudo apt install systemd-journal-remote

# æœåŠ¡ç«¯é…ç½®
sudo systemctl enable systemd-journal-remote
sudo systemctl start systemd-journal-remote

# å®¢æˆ·ç«¯è½¬å‘é…ç½®
# /etc/systemd/journal-remote.conf
[Remote]
URL=https://central-log-server:19532
```

### 7.4 è‡ªå»ºè½»é‡èšåˆæ–¹æ¡ˆ


**ç®€å•çš„æ—¥å¿—èšåˆè„šæœ¬ï¼š**
```bash
#!/bin/bash
# è½»é‡çº§æ—¥å¿—èšåˆæ”¶é›†è„šæœ¬

LOG_COLLECTOR_DIR="/var/log/aggregated"
CENTRAL_SERVER="192.168.1.100"

# åˆ›å»ºèšåˆç›®å½•
mkdir -p "$LOG_COLLECTOR_DIR"

# æ—¥å¿—æ”¶é›†å‡½æ•°
collect_logs() {
    local server_list="$1"
    local date_pattern="$(date +%Y-%m-%d)"
    
    echo "=== $(date): å¼€å§‹æ—¥å¿—æ”¶é›† ===" >> "$LOG_COLLECTOR_DIR/collector.log"
    
    while IFS= read -r server; do
        if [ -n "$server" ] && [ "$server" != "#"* ]; then
            echo "æ”¶é›†æœåŠ¡å™¨ $server çš„æ—¥å¿—..."
            
            # åˆ›å»ºæœåŠ¡å™¨ä¸“ç”¨ç›®å½•
            mkdir -p "$LOG_COLLECTOR_DIR/$server"
            
            # ä½¿ç”¨rsyncåŒæ­¥æ—¥å¿—æ–‡ä»¶
            rsync -avz --timeout=30 \
                "$server:/var/log/messages" \
                "$server:/var/log/nginx/*.log" \
                "$server:/var/log/mysql/*.log" \
                "$LOG_COLLECTOR_DIR/$server/" 2>/dev/null
                
            # è®°å½•æ”¶é›†çŠ¶æ€
            if [ $? -eq 0 ]; then
                echo "$(date): $server - æ”¶é›†æˆåŠŸ" >> "$LOG_COLLECTOR_DIR/collector.log"
            else
                echo "$(date): $server - æ”¶é›†å¤±è´¥" >> "$LOG_COLLECTOR_DIR/collector.log"
            fi
        fi
    done < "$server_list"
}

# æ—¥å¿—èšåˆåˆ†æ
analyze_aggregated_logs() {
    local analysis_file="$LOG_COLLECTOR_DIR/daily_analysis_$(date +%Y%m%d).txt"
    
    echo "=== æ—¥å¿—èšåˆåˆ†ææŠ¥å‘Š ===" > "$analysis_file"
    echo "åˆ†ææ—¶é—´: $(date)" >> "$analysis_file"
    echo >> "$analysis_file"
    
    # ç»Ÿè®¡å„æœåŠ¡å™¨é”™è¯¯æ•°é‡
    echo "--- å„æœåŠ¡å™¨é”™è¯¯ç»Ÿè®¡ ---" >> "$analysis_file"
    for server_dir in "$LOG_COLLECTOR_DIR"/*/; do
        if [ -d "$server_dir" ]; then
            server_name=$(basename "$server_dir")
            error_count=$(find "$server_dir" -name "*.log" -exec grep -ic "error" {} \; | awk '{sum+=$1} END {print sum+0}')
            printf "%-20s: %dä¸ªé”™è¯¯\n" "$server_name" "$error_count" >> "$analysis_file"
        fi
    done
    
    echo >> "$analysis_file"
    echo "--- å…¨å±€é”™è¯¯è¶‹åŠ¿ ---" >> "$analysis_file"
    
    # ç»Ÿè®¡æœ€è¿‘24å°æ—¶çš„é”™è¯¯è¶‹åŠ¿
    for hour in {0..23}; do
        hour_pattern=$(printf "%02d:" $hour)
        hour_errors=$(find "$LOG_COLLECTOR_DIR" -name "*.log" -exec grep "$hour_pattern.*error" {} \; | wc -l)
        echo "${hour}:00-${hour}:59  $hour_errorsä¸ªé”™è¯¯" >> "$analysis_file"
    done
    
    echo >> "$analysis_file" 
    echo "--- å¸¸è§é”™è¯¯æ¨¡å¼ TOP 10 ---" >> "$analysis_file"
    find "$LOG_COLLECTOR_DIR" -name "*.log" -exec grep -i "error" {} \; | \
    awk '{for(i=1;i<=NF;i++) if(tolower($i) ~ /error/) print $(i-1), $i, $(i+1)}' | \
    sort | uniq -c | sort -rn | head -10 >> "$analysis_file"
    
    echo "åˆ†ææŠ¥å‘Šç”Ÿæˆå®Œæˆ: $analysis_file"
}

# ä½¿ç”¨ç¤ºä¾‹
# echo "web01" > servers.txt  
# echo "db01" >> servers.txt
# collect_logs servers.txt
# analyze_aggregated_logs
```

### 7.5 å®æ—¶æ—¥å¿—ç›‘æ§


**å¤šæ–‡ä»¶å®æ—¶ç›‘æ§ï¼š**
```bash
# å¤šæœåŠ¡å™¨å®æ—¶æ—¥å¿—ç›‘æ§
real_time_monitor() {
    local servers_file="$1"
    
    echo "å¯åŠ¨å®æ—¶æ—¥å¿—ç›‘æ§..."
    echo "æŒ‰ Ctrl+C åœæ­¢ç›‘æ§"
    
    # ä½¿ç”¨multitailå·¥å…·ï¼ˆéœ€è¦å®‰è£…ï¼‰
    if command -v multitail >/dev/null; then
        # æ„å»ºmultitailå‘½ä»¤
        cmd="multitail"
        while IFS= read -r server; do
            if [ -n "$server" ] && [ "$server" != "#"* ]; then
                cmd="$cmd -l 'ssh $server tail -f /var/log/messages'"
                cmd="$cmd -l 'ssh $server tail -f /var/log/nginx/error.log'"
            fi
        done < "$servers_file"
        
        eval "$cmd"
    else
        # ä½¿ç”¨ä¼ ç»Ÿtailæ–¹æ³•
        temp_fifo="/tmp/log_monitor_$$"
        mkfifo "$temp_fifo"
        
        while IFS= read -r server; do
            if [ -n "$server" ] && [ "$server" != "#"* ]; then
                ssh "$server" "tail -f /var/log/messages" | \
                sed "s/^/[$server-system] /" >> "$temp_fifo" &
                
                ssh "$server" "tail -f /var/log/nginx/error.log" | \
                sed "s/^/[$server-nginx] /" >> "$temp_fifo" &
            fi
        done < "$servers_file"
        
        # æ˜¾ç¤ºèšåˆçš„æ—¥å¿—æµ
        cat "$temp_fifo"
        
        # æ¸…ç†
        rm -f "$temp_fifo"
    fi
}

# å‘Šè­¦è§¦å‘ç›‘æ§
alert_monitor() {
    local keywords="critical|emergency|fatal|error"
    local email_alert="admin@company.com"
    
    echo "å¯åŠ¨å‘Šè­¦ç›‘æ§..."
    
    tail -f "$LOG_COLLECTOR_DIR"/*/*.log | while read line; do
        if echo "$line" | grep -iE "$keywords" >/dev/null; then
            timestamp=$(date)
            server=$(echo "$line" | awk -F'/' '{print $(NF-1)}')
            
            # æ§åˆ¶å°å‘Šè­¦
            echo "ğŸš¨ [$timestamp] $server: $line"
            
            # é‚®ä»¶å‘Šè­¦ï¼ˆå¦‚æœé…ç½®äº†é‚®ä»¶ç³»ç»Ÿï¼‰
            if command -v mail >/dev/null; then
                echo "$line" | mail -s "æœåŠ¡å™¨å‘Šè­¦: $server" "$email_alert"
            fi
            
            # æ—¥å¿—è®°å½•
            echo "[$timestamp] ALERT: $server - $line" >> "$LOG_COLLECTOR_DIR/alerts.log"
        fi
    done
}
```

---

## 8. ğŸ“ˆ å¼‚å¸¸æ¨¡å¼ç»Ÿè®¡åˆ†æ


### 8.1 å¼‚å¸¸æ¨¡å¼è¯†åˆ«åŸºç¡€


**ä»€ä¹ˆæ˜¯å¼‚å¸¸æ¨¡å¼ï¼Ÿ**
> å¼‚å¸¸æ¨¡å¼å°±åƒ"ç–¾ç—…è¯Šæ–­"ï¼Œé€šè¿‡åˆ†æç—‡çŠ¶çš„å‡ºç°é¢‘ç‡ã€æ—¶é—´è§„å¾‹ã€ç»„åˆç‰¹å¾ç­‰ï¼Œè¯†åˆ«ç³»ç»Ÿå¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚

**å¼‚å¸¸æ£€æµ‹çš„ç»´åº¦ï¼š**
```
é¢‘ç‡å¼‚å¸¸ï¼šé”™è¯¯æ•°é‡çªç„¶å¢åŠ æˆ–å‡å°‘
æ—¶é—´å¼‚å¸¸ï¼šéæ­£å¸¸æ—¶é—´å‡ºç°å¤§é‡æ´»åŠ¨  
æ¨¡å¼å¼‚å¸¸ï¼šå‡ºç°ä»æœªè§è¿‡çš„é”™è¯¯ç±»å‹
å…³è”å¼‚å¸¸ï¼šå¤šä¸ªç³»ç»ŸåŒæ—¶å‡ºç°é—®é¢˜
è¶‹åŠ¿å¼‚å¸¸ï¼šé€æ¸æ¶åŒ–çš„æ€§èƒ½æŒ‡æ ‡
```

### 8.2 é”™è¯¯é¢‘ç‡ç»Ÿè®¡åˆ†æ


#### ğŸ”¸ æ—¶é—´åºåˆ—é”™è¯¯ç»Ÿè®¡


**æŒ‰å°æ—¶ç»Ÿè®¡é”™è¯¯åˆ†å¸ƒï¼š**
```bash
# é”™è¯¯æ—¶é—´åˆ†å¸ƒåˆ†æ
hourly_error_analysis() {
    local log_file="$1"
    local days_back="${2:-7}"  # é»˜è®¤åˆ†ææœ€è¿‘7å¤©
    
    echo "=== æœ€è¿‘ $days_back å¤©é”™è¯¯æ—¶é—´åˆ†å¸ƒåˆ†æ ==="
    
    # åˆ›å»º24å°æ—¶é”™è¯¯ç»Ÿè®¡
    declare -a hourly_errors
    for i in {0..23}; do
        hourly_errors[$i]=0
    done
    
    # åˆ†æä¸åŒæ—¶é—´æ ¼å¼çš„æ—¥å¿—
    if grep -q "^[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\} [0-9]\{2\}:" "$log_file"; then
        # ISOæ—¶é—´æ ¼å¼åˆ†æ
        recent_date=$(date -d "$days_back days ago" "+%Y-%m-%d")
        
        grep -E "(error|critical|emergency)" "$log_file" | \
        awk -v since="$recent_date" '
            $1 >= since {
                if (match($2, /([0-9]{2}):/, arr)) {
                    hours[arr[1]]++
                }
            }
            END {
                for (h=0; h<24; h++) {
                    printf "%02d:00-%02d:59  %dä¸ªé”™è¯¯\n", h, h, hours[sprintf("%02d", h)]+0
                }
            }
        '
    else
        # syslogæ—¶é—´æ ¼å¼åˆ†æ
        grep -iE "(error|critical|emergency)" "$log_file" | \
        awk '{
            if (match($3, /([0-9]{2}):/, arr)) {
                hours[arr[1]]++
            }
        }
        END {
            for (h=0; h<24; h++) {
                printf "%02d:00-%02d:59  %dä¸ªé”™è¯¯\n", h, h, hours[sprintf("%02d", h)]+0
            }
        }'
    fi
    
    echo
    echo "=== å¼‚å¸¸æ—¶æ®µè¯†åˆ« ==="
    # è¯†åˆ«é”™è¯¯é«˜å‘æ—¶æ®µ
    hourly_error_analysis_temp="/tmp/hourly_$"
    if grep -q "^[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}" "$log_file"; then
        recent_date=$(date -d "$days_back days ago" "+%Y-%m-%d")
        grep -E "(error|critical)" "$log_file" | awk -v since="$recent_date" '
            $1 >= since {
                if (match($2, /([0-9]{2}):/, arr)) print arr[1]
            }
        ' | sort -n | uniq -c > "$hourly_error_analysis_temp"
    fi
    
    if [ -f "$hourly_error_analysis_temp" ]; then
        # è®¡ç®—å¹³å‡é”™è¯¯æ•°å’Œå¼‚å¸¸é˜ˆå€¼
        avg_errors=$(awk '{sum+=$1} END {print int(sum/NR)}' "$hourly_error_analysis_temp")
        threshold=$((avg_errors * 2))
        
        echo "å¹³å‡æ¯å°æ—¶é”™è¯¯æ•°: $avg_errors"
        echo "å¼‚å¸¸é˜ˆå€¼ (2å€å¹³å‡): $threshold"
        echo
        echo "å¼‚å¸¸æ—¶æ®µ (è¶…è¿‡é˜ˆå€¼):"
        awk -v thresh="$threshold" '$1 > thresh {printf "%02d:00 æ—¶æ®µ: %dä¸ªé”™è¯¯ (å¼‚å¸¸)\n", $2, $1}' "$hourly_error_analysis_temp"
        
        rm -f "$hourly_error_analysis_temp"
    fi
}
```

#### ğŸ”¸ é”™è¯¯ç±»å‹é¢‘ç‡æ’å


**é”™è¯¯æ¨¡å¼TOPåˆ†æï¼š**
```bash
# é”™è¯¯ç±»å‹ç»Ÿè®¡åˆ†æ
error_pattern_analysis() {
    local log_file="$1"
    local top_n="${2:-20}"
    
    echo "=== TOP $top_n é”™è¯¯æ¨¡å¼åˆ†æ ==="
    
    # æå–é”™è¯¯ä¿¡æ¯è¿›è¡Œæ¨¡å¼åˆ†æ
    temp_errors="/tmp/error_patterns_$"
    grep -iE "(error|critical|fail|exception)" "$log_file" > "$temp_errors"
    
    echo "--- å…·ä½“é”™è¯¯ä¿¡æ¯æ’å ---"
    # æå–å…³é”®é”™è¯¯ä¿¡æ¯ï¼ˆå»é™¤æ—¶é—´æˆ³ã€ä¸»æœºåç­‰ï¼‰
    awk '{
        # ç§»é™¤æ—¶é—´æˆ³å’Œä¸»æœºåï¼Œä¿ç•™é”™è¯¯æ ¸å¿ƒä¿¡æ¯
        gsub(/^[A-Z][a-z]{2} [0-9]{1,2} [0-9]{2}:[0-9]{2}:[0-9]{2}/, "")
        gsub(/^[0-9]{4}-[0-9]{2}-[0-9]{2}[T ][0-9]{2}:[0-9]{2}:[0-9]{2}/, "")
        gsub(/^[a-zA-Z0-9.-]+/, "")
        gsub(/\[[0-9]+\]/, "")
        
        # æ ‡å‡†åŒ–é”™è¯¯ä¿¡æ¯
        if (tolower($0) ~ /connection.*timeout/) print "Connection timeout"
        else if (tolower($0) ~ /permission.*denied/) print "Permission denied"
        else if (tolower($0) ~ /file.*not.*found/) print "File not found"  
        else if (tolower($0) ~ /out.*of.*memory/) print "Out of memory"
        else if (tolower($0) ~ /disk.*full|no.*space/) print "Disk space full"
        else if (tolower($0) ~ /database.*error/) print "Database error"
        else if (tolower($0) ~ /network.*unreachable/) print "Network unreachable"
        else if (tolower($0) ~ /segmentation.*fault/) print "Segmentation fault"
        else if (length($0) > 10) print substr($0, 1, 50)
    }' "$temp_errors" | \
    sort | uniq -c | sort -rn | head -"$top_n" | \
    awk '{printf "%-40s %dæ¬¡\n", substr($0, index($0,$2)), $1}'
    
    echo
    echo "--- é”™è¯¯çº§åˆ«åˆ†å¸ƒ ---"
    grep -oiE "(critical|error|warning|emergency|alert)" "$temp_errors" | \
    tr '[:upper:]' '[:lower:]' | sort | uniq -c | sort -rn | \
    awk '{printf "%-12s %dæ¬¡\n", toupper($2), $1}'
    
    echo  
    echo "--- æœåŠ¡/è¿›ç¨‹é”™è¯¯æ’å ---"
    # æå–è¿›ç¨‹åæˆ–æœåŠ¡å
    awk '{
        if (match($0, /([a-zA-Z0-9_-]+)\[?[0-9]*\]?:/, arr)) {
            print arr[1]
        }
    }' "$temp_errors" | \
    grep -v "^[0-9]*$" | sort | uniq -c | sort -rn | head -10 | \
    awk '{printf "%-20s %dæ¬¡\n", $2, $1}'
    
    rm -f "$temp_errors"
}
```

### 8.3 è¶‹åŠ¿åˆ†æä¸é¢„è­¦


#### ğŸ”¸ é”™è¯¯è¶‹åŠ¿åˆ†æ


**æ—¥/å‘¨/æœˆé”™è¯¯è¶‹åŠ¿ï¼š**
```bash
# é”™è¯¯è¶‹åŠ¿åˆ†æ  
error_trend_analysis() {
    local log_file="$1"
    local analysis_period="${2:-daily}"  # daily, weekly, monthly
    
    echo "=== é”™è¯¯è¶‹åŠ¿åˆ†æ ($analysis_period) ==="
    
    temp_trend="/tmp/trend_analysis_$"
    
    case "$analysis_period" in
        "daily")
            echo "--- æœ€è¿‘30å¤©æ¯æ—¥é”™è¯¯ç»Ÿè®¡ ---"
            # æŒ‰æ—¥æœŸç»Ÿè®¡é”™è¯¯
            for i in {0..29}; do
                date_pattern=$(date -d "$i days ago" "+%Y-%m-%d")
                error_count=$(grep "$date_pattern" "$log_file" | grep -icE "(error|critical|emergency)" || echo "0")
                echo "$date_pattern $error_count" >> "$temp_trend"
            done
            ;;
            
        "weekly")  
            echo "--- æœ€è¿‘12å‘¨æ¯å‘¨é”™è¯¯ç»Ÿè®¡ ---"
            for i in {0..11}; do
                week_start=$(date -d "$((i*7)) days ago" "+%Y-%m-%d")
                week_end=$(date -d "$(((i-1)*7+1)) days ago" "+%Y-%m-%d")
                
                error_count=$(awk -v start="$week_start" -v end="$week_end" '
                    $1 >= start && $1 < end && tolower($0) ~ /(error|critical|emergency)/ {count++}
                    END {print count+0}
                ' "$log_file")
                
                echo "ç¬¬$((12-i))å‘¨ ($week_start) $error_count" >> "$temp_trend"
            done
            ;;
            
        "monthly")
            echo "--- æœ€è¿‘6ä¸ªæœˆæ¯æœˆé”™è¯¯ç»Ÿè®¡ ---"
            for i in {0..5}; do
                month_pattern=$(date -d "$i months ago" "+%Y-%m")
                error_count=$(grep "^$month_pattern" "$log_file" | grep -icE "(error|critical|emergency)" || echo "0")
                month_name=$(date -d "$i months ago" "+%Yå¹´%mæœˆ")
                echo "$month_name $error_count" >> "$temp_trend"
            done
            ;;
    esac
    
    # æ˜¾ç¤ºè¶‹åŠ¿æ•°æ®
    tac "$temp_trend" | while read date count; do
        printf "%-15s %5dä¸ªé”™è¯¯" "$date" "$count"
        
        # ç®€å•çš„å¯è§†åŒ–ï¼ˆç”¨*è¡¨ç¤ºï¼‰
        stars=$(($count / 10))  # æ¯10ä¸ªé”™è¯¯æ˜¾ç¤ºä¸€ä¸ª*
        if [ $stars -gt 50 ]; then stars=50; fi  # æœ€å¤šæ˜¾ç¤º50ä¸ª*
        printf " "
        for ((j=0; j<stars; j++)); do printf "*"; done
        echo
    done
    
    # è¶‹åŠ¿åˆ†æ
    echo
    echo "=== è¶‹åŠ¿åˆ†æç»“æœ ==="
    
    # è®¡ç®—æœ€è¿‘å‡ ä¸ªæ•°æ®ç‚¹çš„å¹³å‡å€¼
    recent_avg=$(tail -7 "$temp_trend" | awk '{sum+=$2} END {print int(sum/NR)}')
    earlier_avg=$(head -7 "$temp_trend" | awk '{sum+=$2} END {print int(sum/NR)}')
    
    if [ $recent_avg -gt $((earlier_avg * 2)) ]; then
        echo "ğŸ”¥ ä¸¥é‡å‘Šè­¦ï¼šé”™è¯¯æ•°é‡æ€¥å‰§ä¸Šå‡ï¼Œæœ€è¿‘å¹³å‡ $recent_avgï¼Œä¹‹å‰å¹³å‡ $earlier_avg"
    elif [ $recent_avg -gt $((earlier_avg + earlier_avg/2)) ]; then
        echo "âš ï¸  æ³¨æ„ï¼šé”™è¯¯æ•°é‡å‘ˆä¸Šå‡è¶‹åŠ¿ï¼Œæœ€è¿‘å¹³å‡ $recent_avgï¼Œä¹‹å‰å¹³å‡ $earlier_avg"  
    elif [ $recent_avg -lt $((earlier_avg / 2)) ]; then
        echo "âœ… æ”¹å–„ï¼šé”™è¯¯æ•°é‡æ˜¾è‘—ä¸‹é™ï¼Œæœ€è¿‘å¹³å‡ $recent_avgï¼Œä¹‹å‰å¹³å‡ $earlier_avg"
    else
        echo "ğŸ“Š ç¨³å®šï¼šé”™è¯¯æ•°é‡åŸºæœ¬ç¨³å®šï¼Œæœ€è¿‘å¹³å‡ $recent_avgï¼Œä¹‹å‰å¹³å‡ $earlier_avg"
    fi
    
    rm -f "$temp_trend"
}
```

### 8.4 ç›¸å…³æ€§åˆ†æ


**å¤šç»´åº¦å…³è”åˆ†æï¼š**
```bash
# å¼‚å¸¸å…³è”åˆ†æ
correlation_analysis() {
    local primary_log="$1"     # ä¸»è¦åˆ†æçš„æ—¥å¿—æ–‡ä»¶
    local secondary_logs="$2"  # å…¶ä»–ç›¸å…³æ—¥å¿—æ–‡ä»¶ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
    local time_window=300      # 5åˆ†é’Ÿæ—¶é—´çª—å£
    
    echo "=== å¼‚å¸¸å…³è”åˆ†æ ==="
    echo "ä¸»æ—¥å¿—: $primary_log"
    echo "å…³è”æ—¥å¿—: $secondary_logs"
    echo "æ—¶é—´çª—å£: ${time_window}ç§’"
    echo
    
    # æå–ä¸»æ—¥å¿—ä¸­çš„å¼‚å¸¸æ—¶é—´ç‚¹
    temp_primary="/tmp/primary_events_$"
    grep -iE "(critical|emergency|error)" "$primary_log" | \
    awk '{
        if (match($0, /([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2})/, arr)) {
            cmd = "date -d \"" arr[1] "\" +%s"
            cmd | getline timestamp
            close(cmd)
            print timestamp, $0
        }
    }' > "$temp_primary"
    
    echo "--- æ—¶é—´å…³è”äº‹ä»¶åˆ†æ ---"
    
    # å¯¹æ¯ä¸ªå¼‚å¸¸äº‹ä»¶ï¼ŒæŸ¥æ‰¾ç›¸å…³æ—¥å¿—ä¸­çš„ç›¸å…³äº‹ä»¶
    while read timestamp event; do
        echo "ä¸»äº‹ä»¶ [$(date -d @$timestamp '+%Y-%m-%d %H:%M:%S')]: $event"
        
        # åœ¨æ—¶é—´çª—å£å†…æŸ¥æ‰¾ç›¸å…³äº‹ä»¶
        start_time=$((timestamp - time_window))
        end_time=$((timestamp + time_window))
        
        for secondary_log in $secondary_logs; do
            if [ -f "$secondary_log" ]; then
                log_name=$(basename "$secondary_log")
                echo "  å…³è”æ—¥å¿— $log_name:"
                
                awk -v start="$start_time" -v end="$end_time" '
                {
                    if (match($0, /([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2})/, arr)) {
                        cmd = "date -d \"" arr[1] "\" +%s"
                        cmd | getline ts
                        close(cmd)
                        
                        if (ts >= start && ts <= end && tolower($0) ~ /(error|warning|fail|timeout)/) {
                            print "    -> " substr($0, 1, 80)
                        }
                    }
                }' "$secondary_log"
            fi
        done
        echo
        
    done < "$temp_primary" | head -20  # åªæ˜¾ç¤ºå‰20ä¸ªå…³è”åˆ†æ
    
    rm -f "$temp_primary"
}
```

### 8.5 å¼‚å¸¸é¢„è­¦ç³»ç»Ÿ


**åŸºäºç»Ÿè®¡çš„æ™ºèƒ½é¢„è­¦ï¼š**
```bash
# æ™ºèƒ½å¼‚å¸¸é¢„è­¦ç³»ç»Ÿ
intelligent_alerting() {
    local log_file="$1"
    local config_file="$2"  # é¢„è­¦é…ç½®æ–‡ä»¶
    
    # é»˜è®¤é…ç½®
    if [ ! -f "$config_file" ]; then
        cat > "$config_file" << 'EOF'
# å¼‚å¸¸é¢„è­¦é…ç½®
ERROR_THRESHOLD_HOURLY=50      # æ¯å°æ—¶é”™è¯¯æ•°é‡é˜ˆå€¼
ERROR_SPIKE_RATIO=3.0          # é”™è¯¯æ¿€å¢å€æ•°
CRITICAL_KEYWORDS="critical,emergency,panic,fatal"
WARNING_KEYWORDS="timeout,connection failed,out of memory"
BASELINE_HOURS=24              # åŸºçº¿è®¡ç®—å°æ—¶æ•°
EOF
    fi
    
    # åŠ è½½é…ç½®
    source "$config_file"
    
    echo "=== æ™ºèƒ½å¼‚å¸¸é¢„è­¦ç³»ç»Ÿ ==="
    echo "åˆ†ææ–‡ä»¶: $log_file"
    echo "é…ç½®æ–‡ä»¶: $config_file"
    echo
    
    # è®¡ç®—åŸºçº¿æ•°æ®
    current_hour=$(date +%H)
    baseline_start=$(date -d "$BASELINE_HOURS hours ago" "+%Y-%m-%d %H:%M:%S")
    
    echo "--- åŸºçº¿åˆ†æ (æœ€è¿‘ ${BASELINE_HOURS}å°æ—¶) ---"
    
    # è®¡ç®—åŸºçº¿é”™è¯¯ç‡
    baseline_errors=$(awk -v since="$baseline_start" '
        $1 " " $2 >= since && tolower($0) ~ /(error|critical|emergency)/ {count++}
        END {print count+0}
    ' "$log_file")
    
    baseline_avg_hourly=$((baseline_errors / BASELINE_HOURS))
    
    echo "åŸºçº¿æœŸé—´æ€»é”™è¯¯æ•°: $baseline_errors"
    echo "åŸºçº¿å°æ—¶å¹³å‡é”™è¯¯æ•°: $baseline_avg_hourly"
    
    # è®¡ç®—å½“å‰å°æ—¶é”™è¯¯æ•°
    current_hour_start=$(date "+%Y-%m-%d %H:00:00")
    current_errors=$(awk -v since="$current_hour_start" '
        $1 " " $2 >= since && tolower($0) ~ /(error|critical|emergency)/ {count++}
        END {print count+0}
    ' "$log_file")
    
    echo "å½“å‰å°æ—¶é”™è¯¯æ•°: $current_errors"
    
    # å¼‚å¸¸æ£€æµ‹
    echo
    echo "--- å¼‚å¸¸æ£€æµ‹ç»“æœ ---"
    
    # é˜ˆå€¼æ£€æµ‹
    if [ $current_errors -gt $ERROR_THRESHOLD_HOURLY ]; then
        echo "ğŸš¨ ä¸¥é‡å‘Šè­¦: å½“å‰å°æ—¶é”™è¯¯æ•° ($current_errors) è¶…è¿‡é˜ˆå€¼ ($ERROR_THRESHOLD_HOURLY)"
        alert_level="CRITICAL"
    fi
    
    # æ¿€å¢æ£€æµ‹
    if [ $baseline_avg_hourly -gt 0 ]; then
        spike_ratio=$(echo "scale=2; $current_errors / $baseline_avg_hourly" | bc)
        spike_threshold=$(echo "scale=2; $ERROR_SPIKE_RATIO" | bc)
        
        if [ $(echo "$spike_ratio >= $spike_threshold" | bc) -eq 1 ]; then
            echo "ğŸ”¥ æ¿€å¢å‘Šè­¦: é”™è¯¯æ•°é‡æ¿€å¢ ${spike_ratio}å€ï¼Œè¶…è¿‡é˜ˆå€¼ ${ERROR_SPIKE_RATIO}å€"
            if [ -z "$alert_level" ] || [ "$alert_level" = "WARNING" ]; then
                alert_level="HIGH"
            fi
        fi
    fi
    
    # å…³é”®è¯æ£€æµ‹
    echo
    echo "--- å…³é”®è¯å¨èƒæ£€æµ‹ ---"
    
    IFS=',' read -ra CRITICAL_WORDS <<< "$CRITICAL_KEYWORDS"
    for keyword in "${CRITICAL_WORDS[@]}"; do
        keyword_count=$(grep -i "$keyword" "$log_file" | \
                       awk -v since="$current_hour_start" '$1 " " $2 >= since' | wc -l)
        if [ $keyword_count -gt 0 ]; then
            echo "âš ï¸  å‘ç°å…³é”®è¯ '$keyword': $keyword_count æ¬¡"
            if [ -z "$alert_level" ]; then
                alert_level="WARNING"  
            fi
        fi
    done
    
    # ç”Ÿæˆå‘Šè­¦æŠ¥å‘Š
    if [ -n "$alert_level" ]; then
        alert_file="/var/log/alerts_$(date +%Y%m%d_%H).log"
        {
            echo "=== å¼‚å¸¸å‘Šè­¦æŠ¥å‘Š ==="
            echo "æ—¶é—´: $(date)"
            echo "çº§åˆ«: $alert_level"
            echo "å½“å‰é”™è¯¯æ•°: $current_errors"
            echo "åŸºçº¿å¹³å‡: $baseline_avg_hourly"  
            echo "æ—¥å¿—æ–‡ä»¶: $log_file"
            echo
            echo "=== æœ€æ–°å¼‚å¸¸äº‹ä»¶ ==="
            tail -20 "$log_file" | grep -iE "(error|critical|emergency)"
        } > "$alert_file"
        
        echo
        echo "ğŸ“‹ å‘Šè­¦æŠ¥å‘Šå·²ç”Ÿæˆ: $alert_file"
        
        # å¦‚æœé…ç½®äº†é€šçŸ¥æ–¹å¼ï¼Œå¯ä»¥åœ¨è¿™é‡Œå‘é€å‘Šè­¦
        # send_alert_notification "$alert_level" "$alert_file"
    else
        echo "âœ… å½“å‰çŠ¶æ€æ­£å¸¸ï¼Œæœªæ£€æµ‹åˆ°å¼‚å¸¸"
    fi
}

# å‘Šè­¦é€šçŸ¥å‘é€ï¼ˆç¤ºä¾‹å®ç°ï¼‰
send_alert_notification() {
    local alert_level="$1"
    local alert_file="$2"
    
    # é‚®ä»¶é€šçŸ¥
    if command -v mail >/dev/null && [ -n "$ALERT_EMAIL" ]; then
        mail -s "[$alert_level] ç³»ç»Ÿå¼‚å¸¸å‘Šè­¦" "$ALERT_EMAIL" < "$alert_file"
    fi
    
    # ä¼ä¸šå¾®ä¿¡/é’‰é’‰é€šçŸ¥ï¼ˆéœ€è¦é…ç½®webhookï¼‰
    if [ -n "$WEBHOOK_URL" ]; then
        curl -X POST "$WEBHOOK_URL" \
             -H 'Content-Type: application/json' \
             -d "{\"msgtype\":\"text\",\"text\":{\"content\":\"$(cat $alert_file)\"}}"
    fi
    
    # çŸ­ä¿¡é€šçŸ¥ï¼ˆéœ€è¦æ¥å…¥çŸ­ä¿¡æœåŠ¡ï¼‰
    # send_sms "$alert_level" "$(head -5 $alert_file)"
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç³»ç»Ÿæ—¥å¿—ä½“ç³»ï¼š/var/logç›®å½•ç»“æ„å’Œå„æ—¥å¿—æ–‡ä»¶ä½œç”¨
ğŸ”¸ æ—¥å¿—å…³è”åˆ†æï¼šè·¨ç³»ç»Ÿã€è·¨æ—¶é—´çš„äº‹ä»¶å…³è”æ–¹æ³•
ğŸ”¸ é”™è¯¯æ¨¡å¼è¯†åˆ«ï¼šå¸¸è§é”™è¯¯ç±»å‹å’Œè¯†åˆ«æŠ€å·§
ğŸ”¸ æ—¶é—´æˆ³å¤„ç†ï¼šä¸åŒæ ¼å¼æ—¶é—´æˆ³çš„ç»Ÿä¸€åŒ–å¤„ç†
ğŸ”¸ çº§åˆ«ç­›é€‰ï¼šåŸºäºæ—¥å¿—çº§åˆ«çš„å¿«é€Ÿé—®é¢˜å®šä½
ğŸ”¸ å…³é”®å­—æœç´¢ï¼šé«˜æ•ˆçš„æœç´¢ç­–ç•¥å’Œè¿‡æ»¤æŠ€å·§
ğŸ”¸ æ—¥å¿—èšåˆï¼šå¤šç³»ç»Ÿæ—¥å¿—çš„é›†ä¸­åŒ–ç®¡ç†
ğŸ”¸ å¼‚å¸¸åˆ†æï¼šåŸºäºç»Ÿè®¡çš„å¼‚å¸¸æ¨¡å¼è¯†åˆ«
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ—¥å¿—åˆ†æçš„å±‚æ¬¡æ€ç»´**
```
ç¬¬ä¸€å±‚ï¼šå•ç‚¹åˆ†æ
- å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„é”™è¯¯æŸ¥æ‰¾
- åŸºç¡€å…³é”®å­—æœç´¢
- ç®€å•çš„æ—¶é—´èŒƒå›´ç­›é€‰

ç¬¬äºŒå±‚ï¼šå…³è”åˆ†æ  
- å¤šä¸ªæ—¥å¿—æ–‡ä»¶çš„æ—¶é—´å…³è”
- è·¨ç³»ç»Ÿäº‹ä»¶çš„å› æœåˆ†æ
- é”™è¯¯æ¨¡å¼çš„è¯†åˆ«å’Œåˆ†ç±»

ç¬¬ä¸‰å±‚ï¼šè¶‹åŠ¿é¢„æµ‹
- åŸºäºå†å²æ•°æ®çš„è¶‹åŠ¿åˆ†æ
- å¼‚å¸¸æ¨¡å¼çš„ç»Ÿè®¡è¯†åˆ«
- æ™ºèƒ½é¢„è­¦å’Œè‡ªåŠ¨åŒ–å“åº”
```

**ğŸ”¹ é—®é¢˜å®šä½çš„é»„é‡‘æ³•åˆ™**
```
æ—¶é—´ä¼˜å…ˆï¼šå…ˆç¡®å®šé—®é¢˜å‘ç”Ÿçš„å‡†ç¡®æ—¶é—´
èŒƒå›´ç¼©å°ï¼šä»å…¨å±€åˆ°å±€éƒ¨ï¼Œé€æ­¥ç¼©å°åˆ†æèŒƒå›´
å…³è”æ€è€ƒï¼šè€ƒè™‘ä¸åŒç³»ç»Ÿé—´çš„ç›¸äº’å½±å“
æ¨¡å¼è¯†åˆ«ï¼šè¯†åˆ«é—®é¢˜çš„é‡å¤æ¨¡å¼å’Œè§„å¾‹
æ ¹å› åˆ†æï¼šé€è¿‡è¡¨è±¡æ‰¾åˆ°é—®é¢˜çš„æ ¹æœ¬åŸå› 
```

**ğŸ”¹ æ—¥å¿—èšåˆçš„ä»·å€¼ä½“ç°**
```
æ•ˆç‡æå‡ï¼š
- ä¸€ä¸ªç•Œé¢æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
- ç»Ÿä¸€çš„æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
- è‡ªåŠ¨åŒ–çš„å…³è”åˆ†æ

è´¨é‡ä¿è¯ï¼š
- å®Œæ•´çš„äº‹ä»¶æ—¶é—´çº¿é‡å»º
- è·¨ç³»ç»Ÿçš„ä¸€è‡´æ€§æ£€æŸ¥
- å†å²æ•°æ®çš„é•¿æœŸä¿å­˜

å†³ç­–æ”¯æŒï¼š
- åŸºäºæ•°æ®çš„è¶‹åŠ¿åˆ†æ
- é‡åŒ–çš„ç³»ç»Ÿå¥åº·æŒ‡æ ‡
- é¢„è­¦å’Œé¢„æµ‹èƒ½åŠ›
```

### 9.3 å®é™…åº”ç”¨åœºæ™¯æŒ‡å¯¼


**ğŸ¯ ä¸åŒè§„æ¨¡ç¯å¢ƒçš„æ—¥å¿—ç­–ç•¥**

```
å°å‹ç¯å¢ƒï¼ˆ1-5å°æœåŠ¡å™¨ï¼‰ï¼š
ç­–ç•¥ï¼šåŸºäºè„šæœ¬çš„ç®€å•èšåˆ
å·¥å…·ï¼šrsyslog + è‡ªå®šä¹‰è„šæœ¬
é‡ç‚¹ï¼šæ ¸å¿ƒé”™è¯¯ç›‘æ§ï¼Œæ‰‹å·¥åˆ†æä¸ºä¸»

ä¸­å‹ç¯å¢ƒï¼ˆ5-50å°æœåŠ¡å™¨ï¼‰ï¼š
ç­–ç•¥ï¼šè½»é‡çº§ELKæˆ–ç±»ä¼¼æ–¹æ¡ˆ  
å·¥å…·ï¼šELK Stackæˆ–Graylog
é‡ç‚¹ï¼šè‡ªåŠ¨åŒ–èšåˆï¼Œè¶‹åŠ¿åˆ†æ

å¤§å‹ç¯å¢ƒï¼ˆ50+å°æœåŠ¡å™¨ï¼‰ï¼š
ç­–ç•¥ï¼šä¸“ä¸šæ—¥å¿—ç®¡ç†å¹³å°
å·¥å…·ï¼šSplunkã€ELK + Kafkaç­‰
é‡ç‚¹ï¼šå®æ—¶åˆ†æï¼Œæ™ºèƒ½å‘Šè­¦ï¼Œå®¹é‡è§„åˆ’
```

**ğŸ¯ ä¸åŒé—®é¢˜ç±»å‹çš„åˆ†æç­–ç•¥**

```
æ€§èƒ½é—®é¢˜ï¼š
å…³æ³¨æŒ‡æ ‡ï¼šå“åº”æ—¶é—´ã€èµ„æºä½¿ç”¨ç‡
æ—¥å¿—é‡ç‚¹ï¼šæ…¢æŸ¥è¯¢ã€å†…å­˜å‘Šè­¦ã€CPUå³°å€¼
åˆ†ææ–¹æ³•ï¼šæ—¶é—´åºåˆ—åˆ†æï¼Œæ€§èƒ½è¶‹åŠ¿

å®‰å…¨äº‹ä»¶ï¼š
å…³æ³¨æŒ‡æ ‡ï¼šç™»å½•å¤±è´¥ã€æƒé™å˜æ›´
æ—¥å¿—é‡ç‚¹ï¼šauth.logã€å®‰å…¨ç›¸å…³äº‹ä»¶
åˆ†ææ–¹æ³•ï¼šå¼‚å¸¸æ¨¡å¼è¯†åˆ«ï¼Œè¡Œä¸ºåˆ†æ

ä¸šåŠ¡æ•…éšœï¼š
å…³æ³¨æŒ‡æ ‡ï¼šé”™è¯¯ç‡ã€å¯ç”¨æ€§  
æ—¥å¿—é‡ç‚¹ï¼šåº”ç”¨æ—¥å¿—ã€ä¸šåŠ¡æµç¨‹æ—¥å¿—
åˆ†ææ–¹æ³•ï¼šäº‹ä»¶æ—¶é—´çº¿é‡å»ºï¼Œå½±å“èŒƒå›´åˆ†æ
```

### 9.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ”§ æ—¥å¿—ç®¡ç†æœ€ä½³å®è·µ**
```
æ—¥å¿—æ”¶é›†ï¼š
- ç»Ÿä¸€æ—¶é—´åŒæ­¥ï¼ˆNTPï¼‰
- æ ‡å‡†åŒ–æ—¥å¿—æ ¼å¼
- åˆç†çš„æ—¥å¿—çº§åˆ«è®¾ç½®
- é€‚å½“çš„æ—¥å¿—è½®è½¬ç­–ç•¥

æ—¥å¿—å­˜å‚¨ï¼š
- å……è¶³çš„å­˜å‚¨ç©ºé—´è§„åˆ’
- åˆç†çš„ä¿ç•™å‘¨æœŸè®¾ç½®  
- é‡è¦æ—¥å¿—çš„å¤‡ä»½ç­–ç•¥
- é«˜å¯ç”¨çš„å­˜å‚¨æ¶æ„

æ—¥å¿—åˆ†æï¼š
- å»ºç«‹æ—¥å¸¸åˆ†ææµç¨‹
- å®šæœŸçš„å¥åº·æ£€æŸ¥æŠ¥å‘Š
- å¼‚å¸¸æ¨¡å¼çš„çŸ¥è¯†åº“ç§¯ç´¯
- è‡ªåŠ¨åŒ–åˆ†æè„šæœ¬çš„ç»´æŠ¤
```

**ğŸ”§ æ•…éšœæ’æŸ¥å·¥ä½œæµç¨‹**
```
ç¬¬1æ­¥ï¼šé—®é¢˜å®šä¹‰
- æ˜ç¡®é—®é¢˜ç°è±¡å’Œå½±å“èŒƒå›´
- ç¡®å®šé—®é¢˜å‘ç”Ÿçš„å‡†ç¡®æ—¶é—´
- æ”¶é›†ç”¨æˆ·åé¦ˆå’Œåˆæ­¥ä¿¡æ¯

ç¬¬2æ­¥ï¼šæ—¥å¿—æ”¶é›†
- æ”¶é›†ç›¸å…³æ—¶é—´æ®µçš„æ‰€æœ‰æ—¥å¿—
- è¿›è¡Œåˆæ­¥çš„é”™è¯¯ä¿¡æ¯ç­›é€‰  
- å»ºç«‹å®Œæ•´çš„äº‹ä»¶æ—¶é—´çº¿

ç¬¬3æ­¥ï¼šå…³è”åˆ†æ
- è·¨ç³»ç»Ÿæ—¥å¿—çš„å…³è”åˆ†æ
- è¯†åˆ«å¯èƒ½çš„å› æœå…³ç³»
- æ’é™¤æ— å…³çš„å¹²æ‰°ä¿¡æ¯

ç¬¬4æ­¥ï¼šæ ¹å› å®šä½
- åŸºäºè¯æ®é“¾ç¡®å®šæ ¹æœ¬åŸå› 
- éªŒè¯æ¨æµ‹çš„å‡†ç¡®æ€§
- åˆ¶å®šè§£å†³æ–¹æ¡ˆ

ç¬¬5æ­¥ï¼šæ€»ç»“æ”¹è¿›
- è®°å½•é—®é¢˜å’Œè§£å†³è¿‡ç¨‹
- æ›´æ–°ç›‘æ§å’Œé¢„è­¦è§„åˆ™
- ä¼˜åŒ–æ—¥å¿—åˆ†ææµç¨‹
```

### 9.5 å·¥å…·é€‰æ‹©æŒ‡å¯¼


**ğŸ› ï¸ å·¥å…·é€‰æ‹©çŸ©é˜µ**

| éœ€æ±‚åœºæ™¯ | **æ¨èå·¥å…·** | **é€‚ç”¨è§„æ¨¡** | **å­¦ä¹ æˆæœ¬** | **åŠŸèƒ½ç‰¹ç‚¹** |
|---------|-------------|-------------|-------------|-------------|
| **åŸºç¡€åˆ†æ** | `grep + awk + è„šæœ¬` | `å°å‹` | `ä½` | `çµæ´»ï¼Œæˆæœ¬ä½` |
| **è½»é‡èšåˆ** | `rsyslog + è‡ªå®šä¹‰è„šæœ¬` | `å°ä¸­å‹` | `ä¸­` | `ç®€å•å¯é ` |
| **å¯è§†åŒ–åˆ†æ** | `ELK Stack` | `ä¸­å¤§å‹` | `ä¸­é«˜` | `åŠŸèƒ½ä¸°å¯Œï¼Œç”Ÿæ€å®Œå–„` |
| **ä¼ä¸šçº§ç®¡ç†** | `Splunk, Graylog` | `å¤§å‹` | `é«˜` | `ä¸“ä¸šåŠŸèƒ½ï¼Œå•†ä¸šæ”¯æŒ` |
| **å®æ—¶ç›‘æ§** | `ELK + Kafka` | `å¤§å‹` | `é«˜` | `é«˜æ€§èƒ½ï¼Œå®æ—¶å¤„ç†` |

**æ ¸å¿ƒè®°å¿†è¦ç‚¹ï¼š**
- æ—¥å¿—åˆ†ææ˜¯ç³»ç»Ÿè¿ç»´çš„åŸºç¡€æŠ€èƒ½ï¼Œéœ€è¦ç³»ç»Ÿæ€§æŒæ¡
- ä¸åŒè§„æ¨¡å’Œéœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·å’Œç­–ç•¥
- å…³è”åˆ†ææ¯”å•ç‚¹åˆ†ææ›´æœ‰ä»·å€¼ï¼Œæ—¶é—´çº¿é‡å»ºæ˜¯å…³é”®
- å¼‚å¸¸æ¨¡å¼è¯†åˆ«éœ€è¦ç§¯ç´¯ç»éªŒå’Œå»ºç«‹çŸ¥è¯†åº“
- è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–æ˜¯æ—¥å¿—åˆ†æçš„å‘å±•æ–¹å‘