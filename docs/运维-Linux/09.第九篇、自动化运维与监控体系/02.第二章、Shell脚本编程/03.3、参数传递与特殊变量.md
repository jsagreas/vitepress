---
title: 3ã€å‚æ•°ä¼ é€’ä¸ç‰¹æ®Šå˜é‡
---
## ğŸ“š ç›®å½•

1. [Shellå‚æ•°ä¼ é€’åŸºç¡€æ¦‚å¿µ](#1-Shellå‚æ•°ä¼ é€’åŸºç¡€æ¦‚å¿µ)
2. [ä½ç½®å‚æ•°è¯¦è§£](#2-ä½ç½®å‚æ•°è¯¦è§£)
3. [ç‰¹æ®Šå˜é‡å®Œæ•´è§£æ](#3-ç‰¹æ®Šå˜é‡å®Œæ•´è§£æ)
4. [shiftå‚æ•°ä½ç§»æ“ä½œ](#4-shiftå‚æ•°ä½ç§»æ“ä½œ)
5. [getoptsé€‰é¡¹è§£æ](#5-getoptsé€‰é¡¹è§£æ)
6. [å‚æ•°éªŒè¯ä¸é”™è¯¯å¤„ç†](#6-å‚æ•°éªŒè¯ä¸é”™è¯¯å¤„ç†)
7. [å‚æ•°é»˜è®¤å€¼ä¸å­˜åœ¨æ€§æ£€æŸ¥](#7-å‚æ•°é»˜è®¤å€¼ä¸å­˜åœ¨æ€§æ£€æŸ¥)
8. [å®æˆ˜åº”ç”¨æŠ€å·§](#8-å®æˆ˜åº”ç”¨æŠ€å·§)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Shellå‚æ•°ä¼ é€’åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å‚æ•°ä¼ é€’

**é€šä¿—ç†è§£**ï¼šå°±åƒç»™ç¨‹åº"å–‚æ•°æ®"ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œè¿è¡Œè„šæœ¬æ—¶å¯ä»¥ä¼ å…¥å„ç§ä¿¡æ¯

```
è¿è¡Œè„šæœ¬çš„æ–¹å¼ï¼š
./myscript.sh  å‚æ•°1  å‚æ•°2  å‚æ•°3
     â†‘         â†‘      â†‘      â†‘
   è„šæœ¬å     ç¬¬1ä¸ª   ç¬¬2ä¸ª   ç¬¬3ä¸ªå‚æ•°
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
- ğŸ“ **æ–‡ä»¶æ“ä½œ**ï¼š`backup.sh /home/user /backup/location`
- ğŸŒ **æœåŠ¡ç®¡ç†**ï¼š`service_control.sh nginx start`  
- ğŸ“Š **æ•°æ®å¤„ç†**ï¼š`analyze.sh data.txt output.csv`
- âš™ï¸ **ç³»ç»Ÿé…ç½®**ï¼š`setup.sh --config production`

### 1.2 å‚æ•°ä¼ é€’çš„æœ¬è´¨

Shellè„šæœ¬æ¥æ”¶å‚æ•°çš„è¿‡ç¨‹å°±æ˜¯**æŠŠå‘½ä»¤è¡Œè¾“å…¥çš„æ–‡å­—æŒ‰ç©ºæ ¼åˆ†å‰²ï¼Œç„¶åä¾æ¬¡ç¼–å·å­˜å‚¨**

```
å‘½ä»¤è¡Œè¾“å…¥ï¼š ./test.sh hello world 123
åˆ†è§£è¿‡ç¨‹ï¼š   è„šæœ¬å=test.sh  $1=hello  $2=world  $3=123
```

---

## 2. ğŸ“‹ ä½ç½®å‚æ•°è¯¦è§£


### 2.1 åŸºæœ¬ä½ç½®å‚æ•°ï¼ˆ$1, $2, $3...ï¼‰


**å«ä¹‰è§£é‡Š**ï¼š`$1`è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ`$2`è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨

```bash
#!/bin/bash
# æ–‡ä»¶åï¼šdemo.sh

echo "è„šæœ¬åç§°ï¼š$0"
echo "ç¬¬1ä¸ªå‚æ•°ï¼š$1" 
echo "ç¬¬2ä¸ªå‚æ•°ï¼š$2"
echo "ç¬¬3ä¸ªå‚æ•°ï¼š$3"
```

**è¿è¡Œæµ‹è¯•**ï¼š
```
$ ./demo.sh apple banana cherry
è„šæœ¬åç§°ï¼š./demo.sh
ç¬¬1ä¸ªå‚æ•°ï¼šapple
ç¬¬2ä¸ªå‚æ•°ï¼šbanana  
ç¬¬3ä¸ªå‚æ•°ï¼šcherry
```

### 2.2 å‚æ•°ä¸ªæ•°å˜é‡ï¼ˆ$#ï¼‰


**å«ä¹‰**ï¼š`$#`å‘Šè¯‰ä½ ä¼ å…¥äº†å¤šå°‘ä¸ªå‚æ•°

```bash
#!/bin/bash
echo "æ€»å…±ä¼ å…¥äº† $# ä¸ªå‚æ•°"

if [ $# -eq 0 ]; then
    echo "æ²¡æœ‰ä¼ å…¥ä»»ä½•å‚æ•°"
elif [ $# -eq 1 ]; then
    echo "ä¼ å…¥äº†1ä¸ªå‚æ•°ï¼š$1"
else
    echo "ä¼ å…¥äº†å¤šä¸ªå‚æ•°"
fi
```

**å®é™…åº”ç”¨**ï¼š
```
$ ./count_params.sh
æ€»å…±ä¼ å…¥äº† 0 ä¸ªå‚æ•°
æ²¡æœ‰ä¼ å…¥ä»»ä½•å‚æ•°

$ ./count_params.sh hello
æ€»å…±ä¼ å…¥äº† 1 ä¸ªå‚æ•°
ä¼ å…¥äº†1ä¸ªå‚æ•°ï¼šhello

$ ./count_params.sh a b c
æ€»å…±ä¼ å…¥äº† 3 ä¸ªå‚æ•°
ä¼ å…¥äº†å¤šä¸ªå‚æ•°
```

### 2.3 æ‰€æœ‰å‚æ•°å˜é‡ï¼ˆ$@ å’Œ $*ï¼‰


**$@** å’Œ **$\*** éƒ½è¡¨ç¤º"æ‰€æœ‰å‚æ•°"ï¼Œä½†æœ‰ç»†å¾®å·®åˆ«ï¼š

| å˜é‡ | å«ä¹‰ | æ¨èä½¿ç”¨åœºæ™¯ |
|------|------|-------------|
| **$@** | æ‰€æœ‰å‚æ•°ï¼ˆä¿æŒç‹¬ç«‹ï¼‰ | âœ… **æ¨è** - å‚æ•°å¯èƒ½åŒ…å«ç©ºæ ¼ |
| **$\*** | æ‰€æœ‰å‚æ•°ï¼ˆåˆå¹¶ä¸ºä¸€ä¸ªï¼‰ | âš ï¸ ç‰¹æ®Šæƒ…å†µä½¿ç”¨ |

```bash
#!/bin/bash
echo "ä½¿ç”¨ \$@:"
for param in "$@"; do
    echo "  å‚æ•°: [$param]"
done

echo "ä½¿ç”¨ \$*:"
for param in "$*"; do  
    echo "  å‚æ•°: [$param]"
done
```

**åŒºåˆ«æ¼”ç¤º**ï¼š
```
$ ./all_params.sh "hello world" "good bye"

ä½¿ç”¨ $@:
  å‚æ•°: [hello world]
  å‚æ•°: [good bye]

ä½¿ç”¨ $*:
  å‚æ•°: [hello world good bye]  # æ³¨æ„ï¼šåˆå¹¶æˆäº†ä¸€ä¸ª
```

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šå‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹éƒ½åº”è¯¥ä½¿ç”¨`"$@"`è€Œä¸æ˜¯`"$*"`

---

## 3. ğŸ”§ ç‰¹æ®Šå˜é‡å®Œæ•´è§£æ


### 3.1 è¿›ç¨‹ç›¸å…³ç‰¹æ®Šå˜é‡


**$$ï¼ˆå½“å‰è¿›ç¨‹IDï¼‰**
```bash
#!/bin/bash
echo "å½“å‰è„šæœ¬çš„è¿›ç¨‹IDï¼š$$"

# å®é™…åº”ç”¨ï¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶
temp_file="/tmp/script_$$.tmp"
echo "åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼š$temp_file"
touch "$temp_file"
```

**$!ï¼ˆæœ€åä¸€ä¸ªåå°è¿›ç¨‹IDï¼‰**
```bash
#!/bin/bash
# å¯åŠ¨åå°è¿›ç¨‹
sleep 10 &
echo "åå°è¿›ç¨‹IDï¼š$!"

# å®é™…åº”ç”¨ï¼šç­‰å¾…åå°è¿›ç¨‹å®Œæˆ
background_pid=$!
wait $background_pid
echo "åå°è¿›ç¨‹å·²å®Œæˆ"
```

### 3.2 è„šæœ¬æ‰§è¡Œç»“æœå˜é‡


**$?ï¼ˆä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼‰**
```bash
#!/bin/bash
ls /existing_directory
if [ $? -eq 0 ]; then
    echo "âœ… ç›®å½•å­˜åœ¨"
else
    echo "âŒ ç›®å½•ä¸å­˜åœ¨æˆ–æ— æƒé™"
fi

# æ›´ç®€æ´çš„å†™æ³•
if ls /nonexistent 2>/dev/null; then
    echo "ç›®å½•å­˜åœ¨"
else
    echo "ç›®å½•ä¸å­˜åœ¨"
fi
```

**é€€å‡ºçŠ¶æ€ç å«ä¹‰**ï¼š
```
0     âœ… æˆåŠŸæ‰§è¡Œ
1     âŒ ä¸€èˆ¬æ€§é”™è¯¯
2     âŒ è¯¯ç”¨Shellå‘½ä»¤  
126   âŒ å‘½ä»¤ä¸èƒ½æ‰§è¡Œ
127   âŒ å‘½ä»¤æœªæ‰¾åˆ°
130   âŒ ç”¨Ctrl+Cç»ˆæ­¢
```

### 3.3 è„šæœ¬åç§°å˜é‡ï¼ˆ$0ï¼‰


**å«ä¹‰**ï¼š`$0`è¡¨ç¤ºè„šæœ¬è‡ªèº«çš„åç§°

```bash
#!/bin/bash
echo "è„šæœ¬å®Œæ•´è·¯å¾„ï¼š$0"
echo "è„šæœ¬åç§°ï¼š$(basename $0)"

# å®é™…åº”ç”¨ï¼šæ ¹æ®è„šæœ¬åæ‰§è¡Œä¸åŒåŠŸèƒ½
script_name=$(basename $0)
case $script_name in
    "backup.sh")
        echo "æ‰§è¡Œå¤‡ä»½åŠŸèƒ½"
        ;;
    "restore.sh") 
        echo "æ‰§è¡Œæ¢å¤åŠŸèƒ½"
        ;;
    *)
        echo "æœªçŸ¥è„šæœ¬ç±»å‹"
        ;;
esac
```

---

## 4. â†”ï¸ shiftå‚æ•°ä½ç§»æ“ä½œ


### 4.1 shiftåŸºæœ¬æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼š`shift`å°±åƒä¼ é€å¸¦ï¼ŒæŠŠå‚æ•°å‘å·¦ç§»åŠ¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¢«"åƒæ‰"

```
æ‰§è¡Œå‰ï¼š $1=apple  $2=banana  $3=cherry
shiftåï¼š $1=banana $2=cherry  $3=(ç©º)
```

### 4.2 shiftåŸºç¡€ä½¿ç”¨


```bash
#!/bin/bash
echo "=== å‚æ•°ä½ç§»æ¼”ç¤º ==="
echo "åˆå§‹çŠ¶æ€ï¼š"
echo "å‚æ•°ä¸ªæ•°ï¼š$#"
echo "æ‰€æœ‰å‚æ•°ï¼š$@"

echo "æ‰§è¡Œ shift åï¼š"
shift
echo "å‚æ•°ä¸ªæ•°ï¼š$#"  
echo "æ‰€æœ‰å‚æ•°ï¼š$@"
echo "ç°åœ¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼š$1"
```

**è¿è¡Œæ•ˆæœ**ï¼š
```
$ ./shift_demo.sh one two three four

=== å‚æ•°ä½ç§»æ¼”ç¤º ===
åˆå§‹çŠ¶æ€ï¼š
å‚æ•°ä¸ªæ•°ï¼š4
æ‰€æœ‰å‚æ•°ï¼šone two three four
æ‰§è¡Œ shift åï¼š
å‚æ•°ä¸ªæ•°ï¼š3
æ‰€æœ‰å‚æ•°ï¼štwo three four
ç°åœ¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼štwo
```

### 4.3 shiftçš„å®é™…åº”ç”¨


**å¤„ç†ä¸å®šä¸ªæ•°çš„å‚æ•°**ï¼š
```bash
#!/bin/bash
# æ–‡ä»¶ï¼šprocess_files.sh

if [ $# -eq 0 ]; then
    echo "ç”¨æ³•ï¼š$0 æ–‡ä»¶1 æ–‡ä»¶2 æ–‡ä»¶3..."
    exit 1
fi

echo "å¼€å§‹å¤„ç†æ–‡ä»¶..."
while [ $# -gt 0 ]; do
    echo "æ­£åœ¨å¤„ç†ï¼š$1"
    # è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ–‡ä»¶å¤„ç†é€»è¾‘
    ls -l "$1" 2>/dev/null || echo "âš ï¸ æ–‡ä»¶ $1 ä¸å­˜åœ¨"
    shift  # ç§»åˆ°ä¸‹ä¸€ä¸ªå‚æ•°
done
echo "æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆ"
```

**æŒ‡å®šä½ç§»æ•°é‡**ï¼š
```bash
#!/bin/bash
echo "åŸå§‹å‚æ•°ï¼š$@"
shift 2  # ä¸€æ¬¡ç§»æ‰2ä¸ªå‚æ•°
echo "ç§»æ‰å‰2ä¸ªåï¼š$@"
```

---

## 5. âš™ï¸ getoptsé€‰é¡¹è§£æ


### 5.1 getoptsåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯é€‰é¡¹è§£æ**ï¼šå¤„ç†åƒ`-h`ã€`-v`ã€`--help`è¿™æ ·çš„å‘½ä»¤è¡Œé€‰é¡¹

```
å¸¸è§å‘½ä»¤è¡Œæ ¼å¼ï¼š
./myscript.sh -h           # æ˜¾ç¤ºå¸®åŠ©
./myscript.sh -v           # æ˜¾ç¤ºç‰ˆæœ¬
./myscript.sh -f file.txt  # æŒ‡å®šæ–‡ä»¶
./myscript.sh -u user -p password  # å¤šä¸ªé€‰é¡¹
```

### 5.2 getoptsåŸºç¡€è¯­æ³•


**åŸºæœ¬ç»“æ„**ï¼š
```bash
while getopts "é€‰é¡¹å­—ç¬¦ä¸²" å˜é‡å; do
    case $å˜é‡å in
        é€‰é¡¹å­—ç¬¦)
            # å¤„ç†è¯¥é€‰é¡¹
            ;;
    esac
done
```

### 5.3 å®é™…åº”ç”¨ç¤ºä¾‹


**ç®€å•é€‰é¡¹å¤„ç†**ï¼š
```bash
#!/bin/bash
# æ–‡ä»¶ï¼šsimple_opts.sh

# æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
show_help() {
    echo "ç”¨æ³•: $0 [é€‰é¡¹]"
    echo "é€‰é¡¹:"
    echo "  -h    æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
    echo "  -v    æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯"  
    echo "  -d    å¯ç”¨è°ƒè¯•æ¨¡å¼"
}

# é»˜è®¤å€¼
debug_mode=false

# è§£æé€‰é¡¹
while getopts "hvd" opt; do
    case $opt in
        h)
            show_help
            exit 0
            ;;
        v)
            echo "ç‰ˆæœ¬: 1.0.0"
            exit 0
            ;;
        d)
            debug_mode=true
            echo "ğŸ” è°ƒè¯•æ¨¡å¼å·²å¯ç”¨"
            ;;
        \?)
            echo "âŒ æ— æ•ˆé€‰é¡¹: -$OPTARG" >&2
            show_help
            exit 1
            ;;
    esac
done

echo "è„šæœ¬å¼€å§‹æ‰§è¡Œ..."
if [ "$debug_mode" = true ]; then
    echo "ğŸ” è°ƒè¯•ä¿¡æ¯ï¼šå½“å‰ç”¨æˆ·=$USER"
fi
```

### 5.4 å¸¦å‚æ•°çš„é€‰é¡¹


```bash
#!/bin/bash
# æ–‡ä»¶ï¼šadvanced_opts.sh

# é»˜è®¤å€¼
username=""
password=""
config_file="/etc/default.conf"

while getopts "u:p:c:h" opt; do
    case $opt in
        u)
            username="$OPTARG"
            ;;
        p)
            password="$OPTARG"
            ;;
        c)
            config_file="$OPTARG"
            ;;
        h)
            echo "ç”¨æ³•: $0 -u ç”¨æˆ·å -p å¯†ç  [-c é…ç½®æ–‡ä»¶]"
            exit 0
            ;;
        :)
            echo "âŒ é€‰é¡¹ -$OPTARG éœ€è¦å‚æ•°" >&2
            exit 1
            ;;
        \?)
            echo "âŒ æ— æ•ˆé€‰é¡¹: -$OPTARG" >&2
            exit 1
            ;;
    esac
done

# æ£€æŸ¥å¿…éœ€å‚æ•°
if [ -z "$username" ] || [ -z "$password" ]; then
    echo "âŒ ç”¨æˆ·åå’Œå¯†ç æ˜¯å¿…éœ€çš„"
    echo "ç”¨æ³•: $0 -u ç”¨æˆ·å -p å¯†ç "
    exit 1
fi

echo "âœ… é…ç½®å®Œæˆï¼š"
echo "ç”¨æˆ·å: $username"
echo "å¯†ç : [å·²è®¾ç½®]"
echo "é…ç½®æ–‡ä»¶: $config_file"
```

**é€‰é¡¹å­—ç¬¦ä¸²è¯´æ˜**ï¼š
```
"u:p:c:h"
 â†‘ â†‘ â†‘ â†‘
 â”‚ â”‚ â”‚ â””â”€ hé€‰é¡¹ä¸å¸¦å‚æ•°
 â”‚ â”‚ â””â”€â”€â”€ cé€‰é¡¹å¸¦å‚æ•°ï¼ˆå†’å·è¡¨ç¤ºéœ€è¦å‚æ•°ï¼‰
 â”‚ â””â”€â”€â”€â”€â”€ pé€‰é¡¹å¸¦å‚æ•°
 â””â”€â”€â”€â”€â”€â”€â”€ ué€‰é¡¹å¸¦å‚æ•°
```

---

## 6. âœ… å‚æ•°éªŒè¯ä¸é”™è¯¯å¤„ç†


### 6.1 å‚æ•°ä¸ªæ•°éªŒè¯


```bash
#!/bin/bash
# æ–‡ä»¶ï¼švalidate_params.sh

# æ£€æŸ¥å‚æ•°ä¸ªæ•°
check_param_count() {
    local required=$1
    local actual=$2
    
    if [ $actual -lt $required ]; then
        echo "âŒ é”™è¯¯ï¼šéœ€è¦è‡³å°‘ $required ä¸ªå‚æ•°ï¼Œä½†åªæä¾›äº† $actual ä¸ª"
        echo "ç”¨æ³•: $0 æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶"
        return 1
    fi
    return 0
}

# ä¸»ç¨‹åº
if ! check_param_count 2 $#; then
    exit 1
fi

source_file="$1"
target_file="$2"

echo "âœ… å‚æ•°éªŒè¯é€šè¿‡"
echo "æºæ–‡ä»¶: $source_file"
echo "ç›®æ ‡æ–‡ä»¶: $target_file"
```

### 6.2 æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥


```bash
#!/bin/bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”å¯è¯»
check_file() {
    local file="$1"
    
    if [ ! -f "$file" ]; then
        echo "âŒ é”™è¯¯ï¼šæ–‡ä»¶ '$file' ä¸å­˜åœ¨"
        return 1
    fi
    
    if [ ! -r "$file" ]; then
        echo "âŒ é”™è¯¯ï¼šæ–‡ä»¶ '$file' ä¸å¯è¯»"
        return 1
    fi
    
    echo "âœ… æ–‡ä»¶ '$file' æ£€æŸ¥é€šè¿‡"
    return 0
}

# ä½¿ç”¨ç¤ºä¾‹
if [ $# -eq 0 ]; then
    echo "è¯·æä¾›è¦æ£€æŸ¥çš„æ–‡ä»¶å"
    exit 1
fi

for file in "$@"; do
    if check_file "$file"; then
        echo "å¤„ç†æ–‡ä»¶: $file"
        # è¿™é‡Œæ·»åŠ å®é™…çš„æ–‡ä»¶å¤„ç†é€»è¾‘
    fi
done
```

### 6.3 æ•°å€¼æœ‰æ•ˆæ€§æ£€æŸ¥


```bash
#!/bin/bash
# æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—
is_number() {
    local input="$1"
    
    # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥æ˜¯å¦ä¸ºæ•°å­—
    if [[ $input =~ ^[0-9]+$ ]]; then
        return 0  # æ˜¯æ•°å­—
    else
        return 1  # ä¸æ˜¯æ•°å­—
    fi
}

# æ£€æŸ¥æ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…
check_range() {
    local num=$1
    local min=$2  
    local max=$3
    
    if [ $num -ge $min ] && [ $num -le $max ]; then
        return 0
    else
        return 1
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
if [ $# -ne 1 ]; then
    echo "ç”¨æ³•: $0 æ•°å­—"
    exit 1
fi

user_input="$1"

if is_number "$user_input"; then
    echo "âœ… '$user_input' æ˜¯æœ‰æ•ˆæ•°å­—"
    
    if check_range $user_input 1 100; then
        echo "âœ… æ•°å­—åœ¨æœ‰æ•ˆèŒƒå›´å†… (1-100)"
    else
        echo "âš ï¸ æ•°å­—è¶…å‡ºèŒƒå›´ (1-100)"
    fi
else
    echo "âŒ '$user_input' ä¸æ˜¯æœ‰æ•ˆæ•°å­—"
    exit 1
fi
```

---

## 7. ğŸ› ï¸ å‚æ•°é»˜è®¤å€¼ä¸å­˜åœ¨æ€§æ£€æŸ¥


### 7.1 å‚æ•°é»˜è®¤å€¼è®¾ç½®ï¼ˆ${var:-default}ï¼‰


**åŸºæœ¬è¯­æ³•å«ä¹‰**ï¼šå¦‚æœå˜é‡ä¸ºç©ºæˆ–æœªè®¾ç½®ï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼

```bash
#!/bin/bash
# æ¼”ç¤ºå„ç§é»˜è®¤å€¼è®¾ç½®æ–¹æ³•

echo "=== å‚æ•°é»˜è®¤å€¼æ¼”ç¤º ==="

# æ–¹æ³•1ï¼š${var:-default} - å˜é‡ä¸ºç©ºæ—¶ä½¿ç”¨é»˜è®¤å€¼
name=${1:-"åŒ¿åç”¨æˆ·"}
echo "ç”¨æˆ·å: $name"

# æ–¹æ³•2ï¼š${var:=default} - å˜é‡ä¸ºç©ºæ—¶è®¾ç½®å¹¶ä½¿ç”¨é»˜è®¤å€¼
config_file=${2:="/etc/default.conf"}
echo "é…ç½®æ–‡ä»¶: $config_file"

# æ–¹æ³•3ï¼šä½¿ç”¨æ¡ä»¶åˆ¤æ–­
port="$3"
if [ -z "$port" ]; then
    port="8080"
fi
echo "ç«¯å£å·: $port"

# å®é™…åº”ç”¨ç¤ºä¾‹
backup_dir=${4:-"/backup/$(date +%Y%m%d)"}
echo "å¤‡ä»½ç›®å½•: $backup_dir"
```

**è¿è¡Œæµ‹è¯•**ï¼š
```
$ ./default_values.sh
ç”¨æˆ·å: åŒ¿åç”¨æˆ·
é…ç½®æ–‡ä»¶: /etc/default.conf  
ç«¯å£å·: 8080
å¤‡ä»½ç›®å½•: /backup/20240917

$ ./default_values.sh "å¼ ä¸‰" "/custom/config" "9090" "/my/backup"
ç”¨æˆ·å: å¼ ä¸‰
é…ç½®æ–‡ä»¶: /custom/config
ç«¯å£å·: 9090
å¤‡ä»½ç›®å½•: /my/backup
```

### 7.2 å‚æ•°å­˜åœ¨æ€§æ£€æŸ¥ï¼ˆ${var:?error}ï¼‰


**å«ä¹‰**ï¼šå¦‚æœå˜é‡æœªè®¾ç½®æˆ–ä¸ºç©ºï¼Œå°±æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºè„šæœ¬

```bash
#!/bin/bash
# æ¼”ç¤ºå¼ºåˆ¶å‚æ•°æ£€æŸ¥

echo "=== å¿…éœ€å‚æ•°æ£€æŸ¥ ==="

# æ£€æŸ¥å¿…éœ€å‚æ•°
database_url=${1:?"âŒ é”™è¯¯ï¼šå¿…é¡»æä¾›æ•°æ®åº“URL"}
username=${2:?"âŒ é”™è¯¯ï¼šå¿…é¡»æä¾›ç”¨æˆ·å"}

echo "âœ… å‚æ•°æ£€æŸ¥é€šè¿‡"
echo "æ•°æ®åº“URL: $database_url"
echo "ç”¨æˆ·å: $username"

# å¯é€‰å‚æ•°å¯ä»¥æœ‰é»˜è®¤å€¼
timeout=${3:-30}
echo "è¶…æ—¶æ—¶é—´: $timeout ç§’"
```

**æµ‹è¯•æ•ˆæœ**ï¼š
```
$ ./required_params.sh
./required_params.sh: line 6: 1: âŒ é”™è¯¯ï¼šå¿…é¡»æä¾›æ•°æ®åº“URL

$ ./required_params.sh "mysql://localhost" 
./required_params.sh: line 7: 2: âŒ é”™è¯¯ï¼šå¿…é¡»æä¾›ç”¨æˆ·å

$ ./required_params.sh "mysql://localhost" "admin"
âœ… å‚æ•°æ£€æŸ¥é€šè¿‡
æ•°æ®åº“URL: mysql://localhost
ç”¨æˆ·å: admin
è¶…æ—¶æ—¶é—´: 30 ç§’
```

### 7.3 é«˜çº§å‚æ•°å¤„ç†æ¨¡å¼


```bash
#!/bin/bash
# ç»¼åˆå‚æ•°å¤„ç†ç¤ºä¾‹

# æ˜¾ç¤ºä½¿ç”¨å¸®åŠ©
show_usage() {
    cat << EOF
ğŸ“– ç”¨æ³•: $0 [é€‰é¡¹] <å¿…éœ€å‚æ•°>

å¿…éœ€å‚æ•°:
  æºæ–‡ä»¶è·¯å¾„

é€‰é¡¹:
  -o, --output DIR    è¾“å‡ºç›®å½• (é»˜è®¤: ./output)  
  -v, --verbose       è¯¦ç»†è¾“å‡ºæ¨¡å¼
  -q, --quiet         å®‰é™æ¨¡å¼
  -h, --help          æ˜¾ç¤ºæ­¤å¸®åŠ©

ç¤ºä¾‹:
  $0 /path/to/source.txt
  $0 -o /tmp -v /path/to/source.txt
EOF
}

# é»˜è®¤é…ç½®
output_dir="./output"
verbose=false
quiet=false

# è§£æé•¿é€‰é¡¹å’ŒçŸ­é€‰é¡¹
while [[ $# -gt 0 ]]; do
    case $1 in
        -o|--output)
            output_dir="$2"
            shift 2
            ;;
        -v|--verbose)
            verbose=true
            shift
            ;;
        -q|--quiet)
            quiet=true
            shift
            ;;
        -h|--help)
            show_usage
            exit 0
            ;;
        --)
            shift
            break
            ;;
        -*)
            echo "âŒ æœªçŸ¥é€‰é¡¹: $1" >&2
            show_usage
            exit 1
            ;;
        *)
            break
            ;;
    esac
done

# æ£€æŸ¥å¿…éœ€å‚æ•°
source_file="$1"
if [ -z "$source_file" ]; then
    echo "âŒ é”™è¯¯ï¼šå¿…é¡»æŒ‡å®šæºæ–‡ä»¶"
    show_usage
    exit 1
fi

# éªŒè¯æ–‡ä»¶å­˜åœ¨
if [ ! -f "$source_file" ]; then
    echo "âŒ é”™è¯¯ï¼šæºæ–‡ä»¶ '$source_file' ä¸å­˜åœ¨"
    exit 1
fi

# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir -p "$output_dir"

echo "âœ… é…ç½®å®Œæˆï¼š"
echo "æºæ–‡ä»¶: $source_file"
echo "è¾“å‡ºç›®å½•: $output_dir"
echo "è¯¦ç»†æ¨¡å¼: $verbose"
echo "å®‰é™æ¨¡å¼: $quiet"
```

---

## 8. ğŸ’¼ å®æˆ˜åº”ç”¨æŠ€å·§


### 8.1 è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬


```bash
#!/bin/bash
# åº”ç”¨éƒ¨ç½²è„šæœ¬ç¤ºä¾‹

# è„šæœ¬é…ç½®
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LOG_FILE="/var/log/deploy.log"

# è®°å½•æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥æƒé™
check_permissions() {
    if [ "$EUID" -ne 0 ]; then
        echo "âŒ æ­¤è„šæœ¬éœ€è¦rootæƒé™è¿è¡Œ"
        exit 1
    fi
}

# ä¸»ç¨‹åº
main() {
    # ç¯å¢ƒå‚æ•° (å¿…éœ€)
    environment=${1:?"âŒ è¯·æŒ‡å®šéƒ¨ç½²ç¯å¢ƒ (dev/test/prod)"}
    
    # åº”ç”¨ç‰ˆæœ¬ (å¯é€‰ï¼Œé»˜è®¤ä¸ºlatest)
    version=${2:-"latest"}
    
    # é…ç½®æ–‡ä»¶ (å¯é€‰)
    config_file=${3:-"/etc/app/config.conf"}
    
    log "å¼€å§‹éƒ¨ç½²åº”ç”¨åˆ° $environment ç¯å¢ƒ"
    log "ç‰ˆæœ¬: $version"
    log "é…ç½®æ–‡ä»¶: $config_file"
    
    # éªŒè¯ç¯å¢ƒå‚æ•°
    case $environment in
        dev|test|prod)
            log "âœ… ç¯å¢ƒéªŒè¯é€šè¿‡: $environment"
            ;;
        *)
            log "âŒ æ— æ•ˆç¯å¢ƒ: $environment"
            exit 1
            ;;
    esac
    
    log "ğŸš€ éƒ¨ç½²å®Œæˆ"
}

# æ‰§è¡Œä¸»ç¨‹åº
check_permissions
main "$@"
```

### 8.2 æ‰¹é‡æ–‡ä»¶å¤„ç†è„šæœ¬


```bash
#!/bin/bash
# æ‰¹é‡æ–‡ä»¶å¤„ç†å·¥å…·

process_file() {
    local file="$1"
    local operation="$2"
    
    case $operation in
        "compress")
            gzip "$file" && echo "âœ… å‹ç¼©å®Œæˆ: $file"
            ;;
        "backup")  
            cp "$file" "${file}.bak" && echo "âœ… å¤‡ä»½å®Œæˆ: $file"
            ;;
        "count")
            lines=$(wc -l < "$file")
            echo "ğŸ“Š $file: $lines è¡Œ"
            ;;
    esac
}

# ä¸»ç¨‹åº
if [ $# -lt 2 ]; then
    echo "ç”¨æ³•: $0 <æ“ä½œ> <æ–‡ä»¶1> [æ–‡ä»¶2] [æ–‡ä»¶3]..."
    echo "æ“ä½œ: compress | backup | count"
    exit 1
fi

operation="$1"
shift  # ç§»é™¤ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæ“ä½œç±»å‹ï¼‰

# éªŒè¯æ“ä½œç±»å‹
case $operation in
    compress|backup|count)
        echo "ğŸ”§ æ‰§è¡Œæ“ä½œ: $operation"
        ;;
    *)
        echo "âŒ ä¸æ”¯æŒçš„æ“ä½œ: $operation"
        exit 1
        ;;
esac

# å¤„ç†æ‰€æœ‰æ–‡ä»¶
for file in "$@"; do
    if [ -f "$file" ]; then
        process_file "$file" "$operation"
    else
        echo "âš ï¸ è·³è¿‡ä¸å­˜åœ¨çš„æ–‡ä»¶: $file"
    fi
done

echo "ğŸ‰ æ‰¹é‡å¤„ç†å®Œæˆ"
```

### 8.3 ç³»ç»Ÿç›‘æ§è„šæœ¬


```bash
#!/bin/bash
# ç³»ç»Ÿèµ„æºç›‘æ§è„šæœ¬

# é…ç½®å‚æ•°
CPU_THRESHOLD=${1:-80}      # CPUä½¿ç”¨ç‡é˜ˆå€¼
MEM_THRESHOLD=${2:-85}      # å†…å­˜ä½¿ç”¨ç‡é˜ˆå€¼  
DISK_THRESHOLD=${3:-90}     # ç£ç›˜ä½¿ç”¨ç‡é˜ˆå€¼

# è·å–ç³»ç»Ÿä¿¡æ¯
get_cpu_usage() {
    top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1
}

get_memory_usage() {
    free | grep Mem | awk '{printf("%.1f"), $3/$2 * 100.0}'
}

get_disk_usage() {
    df / | tail -1 | awk '{print $5}' | cut -d'%' -f1
}

# æ£€æŸ¥å¹¶æŠ¥è­¦
check_resources() {
    local cpu=$(get_cpu_usage)
    local mem=$(get_memory_usage)  
    local disk=$(get_disk_usage)
    
    echo "ğŸ“Š ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ $(date)"
    echo "â”œâ”€â”€ CPU: ${cpu}% (é˜ˆå€¼: ${CPU_THRESHOLD}%)"
    echo "â”œâ”€â”€ å†…å­˜: ${mem}% (é˜ˆå€¼: ${MEM_THRESHOLD}%)"
    echo "â””â”€â”€ ç£ç›˜: ${disk}% (é˜ˆå€¼: ${DISK_THRESHOLD}%)"
    
    # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼
    if (( $(echo "$cpu > $CPU_THRESHOLD" | bc -l) )); then
        echo "ğŸ”¥ è­¦å‘Š: CPUä½¿ç”¨ç‡è¿‡é«˜!"
    fi
    
    if (( $(echo "$mem > $MEM_THRESHOLD" | bc -l) )); then
        echo "ğŸ”¥ è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜!"
    fi
    
    if [ $disk -gt $DISK_THRESHOLD ]; then
        echo "ğŸ”¥ è­¦å‘Š: ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜!"
    fi
}

echo "ğŸ–¥ï¸ å¯åŠ¨ç³»ç»Ÿç›‘æ§ (é˜ˆå€¼: CPU=$CPU_THRESHOLD% MEM=$MEM_THRESHOLD% DISK=$DISK_THRESHOLD%)"
check_resources
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ ä½ç½®å‚æ•°ç³»ç»Ÿ:
â”œâ”€â”€ $1, $2, $3...  # æŒ‰é¡ºåºè·å–å‚æ•°
â”œâ”€â”€ $#             # å‚æ•°æ€»ä¸ªæ•°
â”œâ”€â”€ $@             # æ‰€æœ‰å‚æ•°ï¼ˆæ¨èä½¿ç”¨ï¼‰
â”œâ”€â”€ $*             # æ‰€æœ‰å‚æ•°ï¼ˆç‰¹æ®Šåœºåˆï¼‰
â””â”€â”€ $0             # è„šæœ¬åç§°

ğŸ”§ ç‰¹æ®Šå˜é‡å«ä¹‰:
â”œâ”€â”€ $$             # å½“å‰è¿›ç¨‹ID
â”œâ”€â”€ $!             # æœ€ååå°è¿›ç¨‹ID
â””â”€â”€ $?             # ä¸Šä¸€å‘½ä»¤é€€å‡ºçŠ¶æ€

âš¡ æ ¸å¿ƒæ“ä½œæŠ€å·§:
â”œâ”€â”€ shift          # å‚æ•°ä½ç§»
â”œâ”€â”€ getopts        # é€‰é¡¹è§£æ
â”œâ”€â”€ ${var:-default} # é»˜è®¤å€¼è®¾ç½®
â””â”€â”€ ${var:?error}   # å¿…éœ€å‚æ•°æ£€æŸ¥
```

### 9.2 å‚æ•°å¤„ç†æœ€ä½³å®è·µ


**ğŸ”¹ å‚æ•°éªŒè¯é¡ºåº**ï¼š
```
1. æ£€æŸ¥å‚æ•°ä¸ªæ•° â†’ ä½¿ç”¨ $# 
2. éªŒè¯å‚æ•°æ ¼å¼ â†’ æ­£åˆ™è¡¨è¾¾å¼æˆ–æ¡ä»¶åˆ¤æ–­
3. æ£€æŸ¥æ–‡ä»¶å­˜åœ¨ â†’ [ -f "$file" ]
4. éªŒè¯æƒé™è®¿é—® â†’ [ -r "$file" ]
5. è®¾ç½®é»˜è®¤å€¼ â†’ ${var:-default}
```

**ğŸ”¹ é”™è¯¯å¤„ç†æ¨¡å¼**ï¼š
```bash
# æ ‡å‡†é”™è¯¯å¤„ç†æ¨¡æ¿
handle_error() {
    echo "âŒ é”™è¯¯: $1" >&2
    echo "ğŸ’¡ å»ºè®®: $2" >&2
    exit 1
}

# ä½¿ç”¨ç¤ºä¾‹
[ $# -eq 0 ] && handle_error "ç¼ºå°‘å‚æ•°" "è¯·æä¾›è‡³å°‘ä¸€ä¸ªæ–‡ä»¶å"
```

**ğŸ”¹ å‚æ•°è§£ææ¨¡æ¿**ï¼š
```bash
# æ ‡å‡†å‚æ•°å¤„ç†æ¨¡æ¿
while [[ $# -gt 0 ]]; do
    case $1 in
        -h|--help)    show_help; exit 0 ;;
        -v|--verbose) verbose=true; shift ;;
        -o|--output)  output="$2"; shift 2 ;;
        -*)           echo "æœªçŸ¥é€‰é¡¹: $1"; exit 1 ;;
        *)            break ;;
    esac
done
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ“Š åº”ç”¨åœºæ™¯æ€»ç»“**ï¼š

| åœºæ™¯ | æ ¸å¿ƒæŠ€æœ¯ | å®é™…æ•ˆæœ |
|------|----------|----------|
| **è‡ªåŠ¨åŒ–éƒ¨ç½²** | `ä½ç½®å‚æ•°` + `getopts` | ğŸš€ æé«˜è¿ç»´æ•ˆç‡ |
| **æ‰¹é‡å¤„ç†** | `$@` + `shift` | ğŸ“ å¤„ç†ä»»æ„æ•°é‡æ–‡ä»¶ |
| **ç³»ç»Ÿç›‘æ§** | `é»˜è®¤å€¼` + `å‚æ•°éªŒè¯` | ğŸ“Š çµæ´»é…ç½®é˜ˆå€¼ |
| **æœåŠ¡ç®¡ç†** | `$0` + `caseè¯­å¥` | âš™ï¸ ä¸€è„šæœ¬å¤šåŠŸèƒ½ |

**ğŸ’¡ æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- **$@** æ˜¯æœ€å¸¸ç”¨çš„å‚æ•°å˜é‡ï¼Œè®°ä½åŠ å¼•å·`"$@"`
- **shift** ç”¨äºå¤„ç†ä¸å®šä¸ªæ•°å‚æ•°ï¼Œåƒä¼ é€å¸¦ä¸€æ ·ç§»åŠ¨
- **getopts** å¤„ç†`-h`ã€`-v`è¿™æ ·çš„é€‰é¡¹ï¼Œä¸“ä¸šè„šæœ¬å¿…å¤‡
- **${var:-default}** è®¾ç½®é»˜è®¤å€¼ï¼Œè®©è„šæœ¬æ›´å‹å¥½
- **å‚æ•°éªŒè¯** æ˜¯ä¸“ä¸šè„šæœ¬çš„æ ‡å¿—ï¼Œè¦å…»æˆä¹ æƒ¯

**ğŸ”¥ å®æˆ˜å£è¯€**ï¼š
```
å‚æ•°ä¼ é€’æœ‰è§„å¾‹ï¼Œä½ç½®ç¼–å·è¦ç‰¢è®°
$1$2æŒ‰é¡ºåºï¼Œ$#å‘Šè¯‰æœ‰å‡ ä¸ª  
$@åŒ…å«å…¨éƒ¨åˆ†ï¼Œshiftç§»åŠ¨æœ€å¥½ç”¨
getoptsè§£æé€‰é¡¹ï¼Œé»˜è®¤å€¼è®©è„šæœ¬çµæ´»
éªŒè¯å‚æ•°é˜²å‡ºé”™ï¼Œä¸“ä¸šè„šæœ¬å°±æ˜¯è¿™æ ·ç»ƒæˆçš„ï¼
```