---
title: 16ã€æ—¥å¿—è®°å½•ä¸è¾“å‡ºç®¡ç†
---
## ğŸ“š ç›®å½•

1. [æ—¥å¿—è®°å½•åŸºç¡€æ¦‚å¿µ](#1-æ—¥å¿—è®°å½•åŸºç¡€æ¦‚å¿µ)
2. [æ—¥å¿—çº§åˆ«å®šä¹‰ä¸ä½¿ç”¨](#2-æ—¥å¿—çº§åˆ«å®šä¹‰ä¸ä½¿ç”¨)
3. [æ—¥å¿—æ ¼å¼åŒ–ä¸æ—¶é—´æˆ³](#3-æ—¥å¿—æ ¼å¼åŒ–ä¸æ—¶é—´æˆ³)
4. [æ—¥å¿—è½®è½¬ä¸å¤§å°æ§åˆ¶](#4-æ—¥å¿—è½®è½¬ä¸å¤§å°æ§åˆ¶)
5. [syslogé›†æˆä¸è¿œç¨‹æ—¥å¿—](#5-syslogé›†æˆä¸è¿œç¨‹æ—¥å¿—)
6. [ç»“æ„åŒ–æ—¥å¿—è¾“å‡ºJSON](#6-ç»“æ„åŒ–æ—¥å¿—è¾“å‡ºJSON)
7. [æ—¥å¿—è¿‡æ»¤ä¸æ£€ç´¢ä¼˜åŒ–](#7-æ—¥å¿—è¿‡æ»¤ä¸æ£€ç´¢ä¼˜åŒ–)
8. [æ€§èƒ½æ—¥å¿—ä¸ç›‘æ§æ•°æ®](#8-æ€§èƒ½æ—¥å¿—ä¸ç›‘æ§æ•°æ®)
9. [æ—¥å¿—å®‰å…¨ä¸æ•æ„Ÿä¿¡æ¯è„±æ•](#9-æ—¥å¿—å®‰å…¨ä¸æ•æ„Ÿä¿¡æ¯è„±æ•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ æ—¥å¿—è®°å½•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ—¥å¿—è®°å½•


**é€šä¿—ç†è§£**ï¼šæ—¥å¿—å°±åƒç¨‹åºè¿è¡Œæ—¶çš„"æ—¥è®°æœ¬"ï¼Œè®°å½•ç¨‹åºåšäº†ä»€ä¹ˆã€ä»€ä¹ˆæ—¶å€™åšçš„ã€ç»“æœå¦‚ä½•ã€‚

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
åŒ»ç”Ÿçœ‹ç—… â†’ ç—…å†è®°å½•
è€å¸ˆä¸Šè¯¾ â†’ æ•™å­¦æ—¥å¿—  
ç¨‹åºè¿è¡Œ â†’ ç³»ç»Ÿæ—¥å¿—

ç›®çš„éƒ½æ˜¯ï¼šè®°å½•è¿‡ç¨‹ï¼Œæ–¹ä¾¿å›é¡¾å’Œåˆ†æ
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ” **é—®é¢˜æ’æŸ¥**ï¼šå‡ºé”™æ—¶èƒ½è¿½è¸ªé—®é¢˜åŸå› 
- ğŸ“Š **è¿è¡Œåˆ†æ**ï¼šäº†è§£ç¨‹åºè¿è¡ŒçŠ¶æ€
- ğŸ›¡ï¸ **å®‰å…¨å®¡è®¡**ï¼šè®°å½•æ“ä½œç—•è¿¹
- ğŸ“ˆ **æ€§èƒ½ç›‘æ§**ï¼šåˆ†æç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

### 1.2 Shellä¸­çš„æ—¥å¿—è¾“å‡ºæ–¹å¼


```
æ ‡å‡†è¾“å‡ºæµï¼š
stdin  (0) â†’ æ ‡å‡†è¾“å…¥   â† é”®ç›˜è¾“å…¥
stdout (1) â†’ æ ‡å‡†è¾“å‡º   â† æ­£å¸¸ä¿¡æ¯æ˜¾ç¤ºåˆ°å±å¹•
stderr (2) â†’ é”™è¯¯è¾“å‡º   â† é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåˆ°å±å¹•

é‡å®šå‘ç¬¦å·ï¼š
>   è¦†ç›–å†™å…¥æ–‡ä»¶
>>  è¿½åŠ å†™å…¥æ–‡ä»¶  
2>  é”™è¯¯è¾“å‡ºé‡å®šå‘
&>  æ‰€æœ‰è¾“å‡ºé‡å®šå‘
```

**åŸºç¡€é‡å®šå‘ç¤ºä¾‹**ï¼š
```bash
# æ­£å¸¸è¾“å‡ºåˆ°æ–‡ä»¶
echo "ç¨‹åºå¯åŠ¨" > app.log

# è¿½åŠ è¾“å‡ºåˆ°æ–‡ä»¶  
echo "å¤„ç†å®Œæˆ" >> app.log

# é”™è¯¯è¾“å‡ºé‡å®šå‘
ls /ä¸å­˜åœ¨çš„ç›®å½• 2>> error.log

# åŒæ—¶é‡å®šå‘æ­£å¸¸å’Œé”™è¯¯è¾“å‡º
command &>> all.log
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦ä¸“é—¨çš„æ—¥å¿—ç®¡ç†


| é—®é¢˜åœºæ™¯ | **ä¸è§„èŒƒåšæ³•** | **è§„èŒƒæ—¥å¿—ç®¡ç†** | **ä¼˜åŠ¿** |
|---------|------------|-------------|---------|
| ğŸš¨ **ç¨‹åºå‡ºé”™** | `echo "é”™è¯¯äº†"`åˆ°å±å¹• | `ERRORçº§åˆ«è®°å½•åˆ°æ–‡ä»¶` | `å¯è¿½æº¯ï¼Œä¸ä¸¢å¤±` |
| ğŸ“Š **æ€§èƒ½åˆ†æ** | `å¶å°”çœ‹çœ‹è¿è¡Œæƒ…å†µ` | `å®šæœŸè®°å½•æ€§èƒ½æŒ‡æ ‡` | `æ•°æ®åŒ–åˆ†æ` |
| ğŸ” **é—®é¢˜æ’æŸ¥** | `é è®°å¿†å›æƒ³è¿‡ç¨‹` | `è¯¦ç»†æ—¥å¿—è®°å½•æ“ä½œ` | `ç²¾ç¡®å®šä½é—®é¢˜` |
| ğŸ’¾ **å­˜å‚¨ç®¡ç†** | `æ—¥å¿—æ— é™å¢é•¿` | `è‡ªåŠ¨è½®è½¬å’Œæ¸…ç†` | `èŠ‚çœç£ç›˜ç©ºé—´` |

---

## 2. ğŸ¯ æ—¥å¿—çº§åˆ«å®šä¹‰ä¸ä½¿ç”¨


### 2.1 æ ‡å‡†æ—¥å¿—çº§åˆ«ä½“ç³»


```
æ—¥å¿—çº§åˆ«ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
FATAL    ğŸ”´  è‡´å‘½é”™è¯¯ï¼Œç¨‹åºæ— æ³•ç»§ç»­è¿è¡Œ
ERROR    ğŸŸ   ä¸€èˆ¬é”™è¯¯ï¼Œå½±å“åŠŸèƒ½ä½†ç¨‹åºå¯ç»§ç»­
WARN     ğŸŸ¡  è­¦å‘Šä¿¡æ¯ï¼Œæ½œåœ¨é—®é¢˜æé†’  
INFO     ğŸ”µ  ä¸€èˆ¬ä¿¡æ¯ï¼Œè®°å½•é‡è¦æ“ä½œ
DEBUG    ğŸŸ¢  è°ƒè¯•ä¿¡æ¯ï¼Œè¯¦ç»†æ‰§è¡Œè¿‡ç¨‹
TRACE    âšª  è·Ÿè¸ªä¿¡æ¯ï¼Œæœ€è¯¦ç»†çš„æ‰§è¡Œæµç¨‹
```

**çº§åˆ«é€‰æ‹©åŸåˆ™**ï¼š
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé€šå¸¸åªè®°å½• INFO åŠä»¥ä¸Šçº§åˆ«
- **æµ‹è¯•ç¯å¢ƒ**ï¼šå¯è®°å½• DEBUG çº§åˆ«å¸®åŠ©è°ƒè¯•
- **å¼€å‘ç¯å¢ƒ**ï¼šè®°å½•æ‰€æœ‰çº§åˆ«åŒ…æ‹¬ TRACE

### 2.2 å®ç°æ—¥å¿—çº§åˆ«åŠŸèƒ½


```bash
#!/bin/bash
# æ—¥å¿—çº§åˆ«å®šä¹‰
LOG_LEVEL_FATAL=0
LOG_LEVEL_ERROR=1  
LOG_LEVEL_WARN=2
LOG_LEVEL_INFO=3
LOG_LEVEL_DEBUG=4
LOG_LEVEL_TRACE=5

# å½“å‰æ—¥å¿—çº§åˆ«ï¼ˆå¯é…ç½®ï¼‰
CURRENT_LOG_LEVEL=${LOG_LEVEL_INFO}

# æ—¥å¿—è¾“å‡ºå‡½æ•°
log_message() {
    local level=$1
    local message=$2
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # åªè¾“å‡ºç­‰äºæˆ–é«˜äºå½“å‰çº§åˆ«çš„æ—¥å¿—
    if [[ $level -le $CURRENT_LOG_LEVEL ]]; then
        case $level in
            $LOG_LEVEL_FATAL) echo "[$timestamp] FATAL: $message" ;;
            $LOG_LEVEL_ERROR) echo "[$timestamp] ERROR: $message" ;;
            $LOG_LEVEL_WARN)  echo "[$timestamp] WARN:  $message" ;;
            $LOG_LEVEL_INFO)  echo "[$timestamp] INFO:  $message" ;;
            $LOG_LEVEL_DEBUG) echo "[$timestamp] DEBUG: $message" ;;
            $LOG_LEVEL_TRACE) echo "[$timestamp] TRACE: $message" ;;
        esac
    fi
}

# ä¾¿æ·å‡½æ•°
log_fatal() { log_message $LOG_LEVEL_FATAL "$1"; }
log_error() { log_message $LOG_LEVEL_ERROR "$1"; }  
log_warn()  { log_message $LOG_LEVEL_WARN  "$1"; }
log_info()  { log_message $LOG_LEVEL_INFO  "$1"; }
log_debug() { log_message $LOG_LEVEL_DEBUG "$1"; }
log_trace() { log_message $LOG_LEVEL_TRACE "$1"; }
```

### 2.3 å®é™…ä½¿ç”¨ç¤ºä¾‹


```bash
#!/bin/bash
# æ–‡ä»¶å¤„ç†è„šæœ¬ç¤ºä¾‹

# å¯¼å…¥æ—¥å¿—å‡½æ•°
source logging_functions.sh

process_file() {
    local file=$1
    
    log_info "å¼€å§‹å¤„ç†æ–‡ä»¶: $file"
    
    if [[ ! -f "$file" ]]; then
        log_error "æ–‡ä»¶ä¸å­˜åœ¨: $file"
        return 1
    fi
    
    log_debug "æ£€æŸ¥æ–‡ä»¶æƒé™: $file"
    if [[ ! -r "$file" ]]; then
        log_warn "æ–‡ä»¶æ— è¯»å–æƒé™: $file"
        return 1
    fi
    
    log_trace "å¼€å§‹è¯»å–æ–‡ä»¶å†…å®¹"
    local line_count=$(wc -l < "$file")
    log_info "æ–‡ä»¶åŒ…å« $line_count è¡Œæ•°æ®"
    
    # å¤„ç†é€»è¾‘...
    log_info "æ–‡ä»¶å¤„ç†å®Œæˆ: $file"
}

# ä½¿ç”¨ç¤ºä¾‹
process_file "data.txt"
```

**è¾“å‡ºæ•ˆæœ**ï¼š
```
[2025-01-21 10:30:15] INFO:  å¼€å§‹å¤„ç†æ–‡ä»¶: data.txt
[2025-01-21 10:30:15] INFO:  æ–‡ä»¶åŒ…å« 150 è¡Œæ•°æ®  
[2025-01-21 10:30:16] INFO:  æ–‡ä»¶å¤„ç†å®Œæˆ: data.txt
```

---

## 3. â° æ—¥å¿—æ ¼å¼åŒ–ä¸æ—¶é—´æˆ³


### 3.1 æ—¶é—´æˆ³æ ¼å¼è¯¦è§£


**å¸¸ç”¨æ—¶é—´æ ¼å¼**ï¼š
```bash
# æ ‡å‡†æ ¼å¼
date '+%Y-%m-%d %H:%M:%S'          # 2025-01-21 10:30:15
date '+%Y/%m/%d %H:%M:%S'          # 2025/01/21 10:30:15

# å¸¦æ¯«ç§’çš„ç²¾ç¡®æ ¼å¼  
date '+%Y-%m-%d %H:%M:%S.%3N'      # 2025-01-21 10:30:15.123

# ISO 8601 å›½é™…æ ‡å‡†æ ¼å¼
date '+%Y-%m-%dT%H:%M:%S%z'        # 2025-01-21T10:30:15+0800

# Unixæ—¶é—´æˆ³
date '+%s'                          # 1737426615

# ç´§å‡‘æ ¼å¼ï¼ˆç”¨äºæ–‡ä»¶åï¼‰
date '+%Y%m%d_%H%M%S'              # 20250121_103015
```

**æ—¶åŒºå¤„ç†**ï¼š
```bash
# æ˜¾ç¤ºUTCæ—¶é—´
date -u '+%Y-%m-%d %H:%M:%S UTC'

# æŒ‡å®šæ—¶åŒº
TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S %Z'
TZ='America/New_York' date '+%Y-%m-%d %H:%M:%S %Z'
```

### 3.2 é«˜çº§æ ¼å¼åŒ–å‡½æ•°


```bash
#!/bin/bash
# é«˜çº§æ—¥å¿—æ ¼å¼åŒ–

# è·å–ç²¾ç¡®æ—¶é—´æˆ³ï¼ˆæ”¯æŒæ¯«ç§’ï¼‰
get_timestamp() {
    local format=${1:-'%Y-%m-%d %H:%M:%S'}
    
    # æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ”¯æŒæ¯«ç§’
    if date '+%3N' &>/dev/null; then
        date "+$format.%3N"
    else
        date "+$format"
    fi
}

# æ ¼å¼åŒ–æ—¥å¿—è¾“å‡º
format_log() {
    local level=$1
    local component=${2:-"MAIN"}  
    local message=$3
    local timestamp=$(get_timestamp)
    local process_id=$$
    local user=$(whoami)
    
    # å®Œæ•´æ ¼å¼ï¼šæ—¶é—´æˆ³ [çº§åˆ«] [ç»„ä»¶] [è¿›ç¨‹ID] [ç”¨æˆ·] æ¶ˆæ¯
    printf "[%s] [%-5s] [%-8s] [PID:%-6s] [USER:%-8s] %s\n" \
           "$timestamp" "$level" "$component" "$process_id" "$user" "$message"
}

# ä½¿ç”¨ç¤ºä¾‹
format_log "INFO" "DATABASE" "è¿æ¥æ•°æ®åº“æˆåŠŸ"
format_log "ERROR" "NETWORK" "ç½‘ç»œè¿æ¥è¶…æ—¶"  
format_log "DEBUG" "PARSER" "è§£æé…ç½®æ–‡ä»¶å®Œæˆ"
```

**è¾“å‡ºæ•ˆæœ**ï¼š
```
[2025-01-21 10:30:15.123] [INFO ] [DATABASE] [PID:12345 ] [USER:admin   ] è¿æ¥æ•°æ®åº“æˆåŠŸ
[2025-01-21 10:30:16.456] [ERROR] [NETWORK ] [PID:12345 ] [USER:admin   ] ç½‘ç»œè¿æ¥è¶…æ—¶  
[2025-01-21 10:30:17.789] [DEBUG] [PARSER  ] [PID:12345 ] [USER:admin   ] è§£æé…ç½®æ–‡ä»¶å®Œæˆ
```

### 3.3 å½©è‰²æ—¥å¿—è¾“å‡º


```bash
#!/bin/bash
# å½©è‰²æ—¥å¿—è¾“å‡ºï¼ˆä»…åœ¨ç»ˆç«¯æ˜¾ç¤ºï¼Œæ–‡ä»¶è®°å½•ä¸åŒ…å«é¢œè‰²ç ï¼‰

# ANSI é¢œè‰²ä»£ç 
RED='\033[0;31m'
GREEN='\033[0;32m'  
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # No Color

# å½©è‰²æ—¥å¿—å‡½æ•°
colored_log() {
    local level=$1
    local message=$2
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local color_code=""
    
    case $level in
        "FATAL") color_code=$RED ;;
        "ERROR") color_code=$RED ;;
        "WARN")  color_code=$YELLOW ;;
        "INFO")  color_code=$BLUE ;;
        "DEBUG") color_code=$GREEN ;;  
        "TRACE") color_code=$CYAN ;;
    esac
    
    # æ£€æŸ¥æ˜¯å¦è¾“å‡ºåˆ°ç»ˆç«¯
    if [[ -t 1 ]]; then
        # ç»ˆç«¯è¾“å‡ºï¼šå¸¦é¢œè‰²
        printf "${color_code}[%s] %-5s: %s${NC}\n" "$timestamp" "$level" "$message"
    else
        # æ–‡ä»¶è¾“å‡ºï¼šæ— é¢œè‰²
        printf "[%s] %-5s: %s\n" "$timestamp" "$level" "$message"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
colored_log "INFO" "ç³»ç»Ÿå¯åŠ¨å®Œæˆ"
colored_log "WARN" "å†…å­˜ä½¿ç”¨ç‡è¾ƒé«˜"
colored_log "ERROR" "æ•°æ®åº“è¿æ¥å¤±è´¥"
```

---

## 4. ğŸ”„ æ—¥å¿—è½®è½¬ä¸å¤§å°æ§åˆ¶


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—è½®è½¬


**é—®é¢˜åœºæ™¯**ï¼š
```
æ—¥å¿—æ–‡ä»¶æŒç»­å¢é•¿ï¼š
app.log     â†’  1MB   âœ… æ­£å¸¸
ä¸€å‘¨å       â†’  50MB  âš ï¸ åå¤§
ä¸€ä¸ªæœˆå     â†’  500MB ğŸš¨ å¤ªå¤§äº†ï¼
ä¸‰ä¸ªæœˆå     â†’  2GB   ğŸ’¥ ç£ç›˜æ»¡äº†ï¼

è§£å†³æ–¹æ¡ˆï¼šæ—¥å¿—è½®è½¬
app.log           â† å½“å‰æ—¥å¿—ï¼ˆæœ€æ–°ï¼‰
app.log.1         â† æ˜¨å¤©çš„æ—¥å¿—  
app.log.2         â† å‰å¤©çš„æ—¥å¿—
app.log.3.gz      â† 3å¤©å‰çš„æ—¥å¿—ï¼ˆå‹ç¼©ï¼‰
```

**è½®è½¬ç­–ç•¥**ï¼š
- ğŸ“ **æŒ‰å¤§å°è½®è½¬**ï¼šæ–‡ä»¶è¶…è¿‡10MBå°±è½®è½¬
- ğŸ“… **æŒ‰æ—¶é—´è½®è½¬**ï¼šæ¯å¤©/æ¯å‘¨/æ¯æœˆè½®è½¬ä¸€æ¬¡  
- ğŸ—‚ï¸ **ä¿ç•™æ•°é‡**ï¼šåªä¿ç•™æœ€è¿‘7ä¸ªæ—¥å¿—æ–‡ä»¶
- ğŸ—œï¸ **å‹ç¼©å­˜å‚¨**ï¼šæ—§æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨å‹ç¼©èŠ‚çœç©ºé—´

### 4.2 ç®€å•æ—¥å¿—è½®è½¬å®ç°


```bash
#!/bin/bash
# åŸºç¡€æ—¥å¿—è½®è½¬å‡½æ•°

rotate_log() {
    local log_file=$1
    local max_size=${2:-10485760}  # é»˜è®¤10MB
    local max_files=${3:-7}        # é»˜è®¤ä¿ç•™7ä¸ªæ–‡ä»¶
    
    # æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”è¶…è¿‡å¤§å°é™åˆ¶
    if [[ -f "$log_file" ]] && [[ $(stat -f%z "$log_file" 2>/dev/null || stat -c%s "$log_file") -gt $max_size ]]; then
        
        echo "æ—¥å¿—æ–‡ä»¶ $log_file è¶…è¿‡å¤§å°é™åˆ¶ï¼Œå¼€å§‹è½®è½¬..."
        
        # åˆ é™¤æœ€æ—§çš„æ—¥å¿—æ–‡ä»¶
        local oldest_log="${log_file}.${max_files}"
        [[ -f "$oldest_log" || -f "${oldest_log}.gz" ]] && rm -f "$oldest_log" "${oldest_log}.gz"
        
        # ä¾æ¬¡é‡å‘½åç°æœ‰æ—¥å¿—æ–‡ä»¶  
        for ((i=max_files-1; i>=1; i--)); do
            local current_log="${log_file}.$i"
            local next_log="${log_file}.$((i+1))"
            
            [[ -f "$current_log" ]] && mv "$current_log" "$next_log"
            [[ -f "${current_log}.gz" ]] && mv "${current_log}.gz" "${next_log}.gz"
        done
        
        # å½“å‰æ—¥å¿—æ–‡ä»¶é‡å‘½åä¸º .1
        mv "$log_file" "${log_file}.1"
        
        # å‹ç¼©æ˜¨å¤©çš„æ—¥å¿—æ–‡ä»¶
        [[ -f "${log_file}.1" ]] && gzip "${log_file}.1"
        
        # åˆ›å»ºæ–°çš„ç©ºæ—¥å¿—æ–‡ä»¶
        touch "$log_file"
        
        echo "æ—¥å¿—è½®è½¬å®Œæˆ"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
rotate_log "/var/log/myapp.log" 10485760 7
```

### 4.3 é«˜çº§è½®è½¬åŠŸèƒ½


```bash
#!/bin/bash  
# é«˜çº§æ—¥å¿—è½®è½¬ç³»ç»Ÿ

# é…ç½®å‚æ•°
declare -A LOG_CONFIG=(
    ["max_size"]="10M"           # æœ€å¤§æ–‡ä»¶å¤§å°
    ["max_files"]="7"            # ä¿ç•™æ–‡ä»¶æ•°é‡  
    ["compress"]="yes"           # æ˜¯å¦å‹ç¼©
    ["compress_delay"]="1"       # å»¶è¿Ÿå‹ç¼©ï¼ˆå¤©ï¼‰
    ["date_ext"]="yes"           # ä½¿ç”¨æ—¥æœŸæ‰©å±•å
    ["rotate_empty"]="no"        # æ˜¯å¦è½®è½¬ç©ºæ–‡ä»¶
)

# è§£æå¤§å°å•ä½
parse_size() {
    local size_str=$1
    local size_num=$(echo "$size_str" | sed 's/[^0-9]//g')
    local size_unit=$(echo "$size_str" | sed 's/[0-9]//g' | tr '[:lower:]' '[:upper:]')
    
    case $size_unit in
        "K"|"KB") echo $((size_num * 1024)) ;;
        "M"|"MB") echo $((size_num * 1024 * 1024)) ;;  
        "G"|"GB") echo $((size_num * 1024 * 1024 * 1024)) ;;
        *) echo "$size_num" ;;
    esac
}

# é«˜çº§è½®è½¬å‡½æ•°
advanced_rotate() {
    local log_file=$1
    local max_size_bytes=$(parse_size "${LOG_CONFIG[max_size]}")
    local max_files=${LOG_CONFIG[max_files]}
    
    # æ£€æŸ¥æ–‡ä»¶å¤§å°
    if [[ -f "$log_file" ]]; then
        local current_size=$(stat -f%z "$log_file" 2>/dev/null || stat -c%s "$log_file")
        
        if [[ $current_size -gt $max_size_bytes ]]; then
            local timestamp=$(date '+%Y%m%d-%H%M%S')
            local backup_name
            
            # æ ¹æ®é…ç½®å†³å®šå¤‡ä»½æ–‡ä»¶å‘½åæ–¹å¼
            if [[ "${LOG_CONFIG[date_ext]}" == "yes" ]]; then
                backup_name="${log_file}-${timestamp}"
            else  
                backup_name="${log_file}.1"
            fi
            
            # æ‰§è¡Œè½®è½¬
            echo "$(date '+%Y-%m-%d %H:%M:%S') - è½®è½¬æ—¥å¿—æ–‡ä»¶: $log_file -> $backup_name"
            mv "$log_file" "$backup_name"
            touch "$log_file"
            
            # å‹ç¼©å¤„ç†
            if [[ "${LOG_CONFIG[compress]}" == "yes" ]]; then
                gzip "$backup_name"
                backup_name="${backup_name}.gz"
            fi
            
            # æ¸…ç†æ—§æ–‡ä»¶
            cleanup_old_logs "$log_file" "$max_files"
        fi
    fi
}

# æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
cleanup_old_logs() {
    local log_file=$1
    local max_files=$2
    local log_dir=$(dirname "$log_file")
    local log_name=$(basename "$log_file")
    
    # æŸ¥æ‰¾å¹¶åˆ é™¤è¶…è¿‡ä¿ç•™æ•°é‡çš„æ–‡ä»¶
    local old_files=$(ls -t "${log_dir}/${log_name}"* 2>/dev/null | tail -n +$((max_files + 2)))
    
    if [[ -n "$old_files" ]]; then
        echo "æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶: $old_files"
        echo "$old_files" | xargs rm -f
    fi
}
```

### 4.4 ä½¿ç”¨logrotateç³»ç»Ÿå·¥å…·


```bash
# åˆ›å»ºlogrotateé…ç½®æ–‡ä»¶: /etc/logrotate.d/myapp
/var/log/myapp/*.log {
    daily                    # æ¯å¤©è½®è½¬
    missingok               # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
    rotate 7                # ä¿ç•™7ä¸ªæ–‡ä»¶
    compress               # å‹ç¼©æ—§æ–‡ä»¶
    delaycompress          # å»¶è¿Ÿå‹ç¼©
    notifempty            # ç©ºæ–‡ä»¶ä¸è½®è½¬
    sharedscripts         # å¤šæ–‡ä»¶å…±äº«è„šæœ¬
    postrotate            # è½®è½¬åæ‰§è¡Œçš„å‘½ä»¤
        systemctl reload myapp
    endscript
}
```

---

## 5. ğŸŒ syslogé›†æˆä¸è¿œç¨‹æ—¥å¿—


### 5.1 ä»€ä¹ˆæ˜¯syslog


**é€šä¿—è§£é‡Š**ï¼šsyslogå°±åƒLinuxç³»ç»Ÿçš„"ç»Ÿä¸€é‚®å±€"ï¼Œæ‰€æœ‰ç¨‹åºéƒ½å¯ä»¥æŠŠæ—¥å¿—"é‚®ä»¶"äº¤ç»™å®ƒï¼Œç”±å®ƒç»Ÿä¸€åˆ†ç±»ã€å­˜å‚¨å’Œè½¬å‘ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼šæ¯ä¸ªç¨‹åºè‡ªå·±ç®¡ç†æ—¥å¿—
ç¨‹åºA â†’ A.log
ç¨‹åºB â†’ B.log  
ç¨‹åºC â†’ C.log
é—®é¢˜ï¼šæ ¼å¼ä¸ç»Ÿä¸€ï¼Œç®¡ç†å¤æ‚

syslogæ–¹å¼ï¼šç»Ÿä¸€æ—¥å¿—ç®¡ç†
ç¨‹åºA â”
ç¨‹åºB â”œâ”€â”€ â†’ syslogæœåŠ¡ â†’ ç»Ÿä¸€æ ¼å¼åŒ– â†’ åˆ†ç±»å­˜å‚¨/è¿œç¨‹å‘é€
ç¨‹åºC â”˜
ä¼˜åŠ¿ï¼šæ ¼å¼ç»Ÿä¸€ï¼Œé›†ä¸­ç®¡ç†ï¼Œæ”¯æŒè¿œç¨‹
```

### 5.2 syslogçš„è®¾æ–½å’Œçº§åˆ«


**è®¾æ–½ï¼ˆFacilityï¼‰**- æ—¥å¿—æ¥æºåˆ†ç±»ï¼š
```bash
kern     (0)  â†’ å†…æ ¸æ¶ˆæ¯
user     (1)  â†’ ç”¨æˆ·ç¨‹åº  
mail     (2)  â†’ é‚®ä»¶ç³»ç»Ÿ
daemon   (3)  â†’ ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹
auth     (4)  â†’ å®‰å…¨/è®¤è¯
syslog   (5)  â†’ syslogè‡ªèº«æ¶ˆæ¯
lpr      (6)  â†’ æ‰“å°ç³»ç»Ÿ
news     (7)  â†’ æ–°é—»ç³»ç»Ÿ
uucp     (8)  â†’ UUCPç³»ç»Ÿ
cron     (9)  â†’ å®šæ—¶ä»»åŠ¡
local0-7 (16-23) â†’ æœ¬åœ°ä½¿ç”¨
```

**çº§åˆ«ï¼ˆPriorityï¼‰**- æ—¥å¿—é‡è¦æ€§ï¼š
```bash
emerg    (0)  â†’ ç´§æ€¥æƒ…å†µï¼Œç³»ç»Ÿæ— æ³•ä½¿ç”¨
alert    (1)  â†’ å¿…é¡»ç«‹å³é‡‡å–è¡ŒåŠ¨  
crit     (2)  â†’ ä¸¥é‡æƒ…å†µ
err      (3)  â†’ é”™è¯¯æƒ…å†µ
warning  (4)  â†’ è­¦å‘Šä¿¡æ¯
notice   (5)  â†’ æ­£å¸¸ä½†é‡è¦çš„ä¿¡æ¯
info     (6)  â†’ ä¸€èˆ¬ä¿¡æ¯
debug    (7)  â†’ è°ƒè¯•ä¿¡æ¯
```

### 5.3 åœ¨Shellè„šæœ¬ä¸­ä½¿ç”¨syslog


```bash
#!/bin/bash
# Shellè„šæœ¬ä¸­é›†æˆsyslog

# åŸºç¡€loggerä½¿ç”¨
log_to_syslog() {
    local level=$1
    local message=$2
    local tag=${3:-"myscript"}
    
    # ä½¿ç”¨loggerå‘½ä»¤å‘é€åˆ°syslog
    logger -p "local0.${level}" -t "$tag" "$message"
}

# ä¾¿æ·å‡½æ•°
syslog_info() { 
    log_to_syslog "info" "$1" "${2:-myscript}"; 
}

syslog_warn() { 
    log_to_syslog "warning" "$1" "${2:-myscript}"; 
}

syslog_error() { 
    log_to_syslog "err" "$1" "${2:-myscript}"; 
}

# ä½¿ç”¨ç¤ºä¾‹
syslog_info "è„šæœ¬å¼€å§‹æ‰§è¡Œ" "backup_script"
syslog_warn "ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡80%" "disk_monitor"  
syslog_error "å¤‡ä»½å¤±è´¥ï¼šç›®æ ‡ç›®å½•ä¸å­˜åœ¨" "backup_script"
```

**é«˜çº§syslogé›†æˆ**ï¼š
```bash
#!/bin/bash
# é«˜çº§syslogé›†æˆç¤ºä¾‹

# syslogé…ç½®
SYSLOG_FACILITY="local0"
SYSLOG_TAG="myapp"
SYSLOG_ENABLED=true

# åŒè¾“å‡ºï¼šåŒæ—¶è®°å½•åˆ°æ–‡ä»¶å’Œsyslog
dual_log() {
    local level=$1
    local message=$2
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # è¾“å‡ºåˆ°æœ¬åœ°æ—¥å¿—æ–‡ä»¶
    echo "[$timestamp] [$level] $message" >> "/var/log/myapp.log"
    
    # å‘é€åˆ°syslogï¼ˆå¦‚æœå¯ç”¨ï¼‰
    if [[ "$SYSLOG_ENABLED" == "true" ]]; then
        local syslog_level
        case $level in
            "ERROR"|"FATAL") syslog_level="err" ;;
            "WARN") syslog_level="warning" ;;
            "INFO") syslog_level="info" ;;
            "DEBUG") syslog_level="debug" ;;
            *) syslog_level="info" ;;
        esac
        
        logger -p "${SYSLOG_FACILITY}.${syslog_level}" -t "$SYSLOG_TAG" "$message"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
dual_log "INFO" "åº”ç”¨ç¨‹åºå¯åŠ¨å®Œæˆ"
dual_log "WARN" "å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°85%"
dual_log "ERROR" "æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œå°è¯•é‡è¿"
```

### 5.4 è¿œç¨‹æ—¥å¿—é…ç½®


**rsyslogé…ç½®å‘é€ç«¯** (`/etc/rsyslog.conf`):
```bash
# å‘é€æœ¬åœ°local0è®¾æ–½çš„æ—¥å¿—åˆ°è¿œç¨‹æœåŠ¡å™¨
local0.*    $$192.168.1.100:514

# å‘é€æ‰€æœ‰çº§åˆ«ä¸ºerroråŠä»¥ä¸Šçš„æ—¥å¿—åˆ°è¿œç¨‹
*.err       $$log-server.company.com:514

# ä½¿ç”¨TCPåè®®å‘é€ï¼ˆæ›´å¯é ï¼‰
*.info      $$(o)log-server.company.com:601
```

**Shellè„šæœ¬è¿œç¨‹æ—¥å¿—ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# ç›´æ¥å‘é€æ—¥å¿—åˆ°è¿œç¨‹syslogæœåŠ¡å™¨

send_remote_log() {
    local message=$1
    local remote_host=${2:-"192.168.1.100"}
    local remote_port=${3:-"514"}
    local facility=${4:-"local0"}
    local level=${5:-"info"}
    
    # æ„é€ syslogæ¶ˆæ¯æ ¼å¼
    local priority=$(get_syslog_priority "$facility" "$level")
    local timestamp=$(date '+%b %d %H:%M:%S')
    local hostname=$(hostname)
    local tag="remote_script"
    
    local syslog_message="<${priority}>${timestamp} ${hostname} ${tag}: ${message}"
    
    # å‘é€UDPæ¶ˆæ¯åˆ°è¿œç¨‹syslogæœåŠ¡å™¨
    echo "$syslog_message" | nc -u -w1 "$remote_host" "$remote_port"
}

# è®¡ç®—syslogä¼˜å…ˆçº§  
get_syslog_priority() {
    local facility=$1
    local level=$2
    
    local facility_num
    case $facility in
        "local0") facility_num=16 ;;
        "local1") facility_num=17 ;;
        "user") facility_num=1 ;;
        *) facility_num=1 ;;
    esac
    
    local level_num
    case $level in
        "emerg") level_num=0 ;;
        "alert") level_num=1 ;;  
        "crit") level_num=2 ;;
        "err") level_num=3 ;;
        "warning") level_num=4 ;;
        "notice") level_num=5 ;;
        "info") level_num=6 ;;
        "debug") level_num=7 ;;
        *) level_num=6 ;;
    esac
    
    echo $((facility_num * 8 + level_num))
}

# ä½¿ç”¨ç¤ºä¾‹
send_remote_log "è¿œç¨‹å¤‡ä»½ä»»åŠ¡å®Œæˆ" "192.168.1.100" 514 "local0" "info"
```

---

## 6. ğŸ“‹ ç»“æ„åŒ–æ—¥å¿—è¾“å‡ºJSON


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç»“æ„åŒ–æ—¥å¿—


**ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—çš„é—®é¢˜**ï¼š
```
[2025-01-21 10:30:15] INFO: ç”¨æˆ· admin ç™»å½•æˆåŠŸï¼ŒIP: 192.168.1.100
[2025-01-21 10:30:20] ERROR: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œé”™è¯¯ä»£ç : 1045

é—®é¢˜ï¼š
âŒ æ ¼å¼ä¸ç»Ÿä¸€ï¼Œéš¾ä»¥è‡ªåŠ¨åŒ–è§£æ
âŒ å­—æ®µæå–å›°éš¾ï¼Œéœ€è¦å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼
âŒ ä¸æ”¯æŒåµŒå¥—æ•°æ®ç»“æ„
âŒ éš¾ä»¥ä¸ç°ä»£æ—¥å¿—åˆ†æå·¥å…·é›†æˆ
```

**ç»“æ„åŒ–JSONæ—¥å¿—çš„ä¼˜åŠ¿**ï¼š
```json
{
  "timestamp": "2025-01-21T10:30:15+08:00",
  "level": "INFO", 
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ",
  "user": "admin",
  "source_ip": "192.168.1.100",
  "session_id": "abc123",
  "response_time": 150
}

ä¼˜åŠ¿ï¼š
âœ… æ ¼å¼ç»Ÿä¸€ï¼Œæ˜“äºè§£æ
âœ… å­—æ®µæ˜ç¡®ï¼Œä¾¿äºæŸ¥è¯¢å’Œåˆ†æ  
âœ… æ”¯æŒå¤æ‚æ•°æ®ç»“æ„
âœ… ä¸ELKã€Grafanaç­‰å·¥å…·å®Œç¾é›†æˆ
```

### 6.2 Shellä¸­ç”ŸæˆJSONæ—¥å¿—


**åŸºç¡€JSONæ—¥å¿—å‡½æ•°**ï¼š
```bash
#!/bin/bash
# åŸºç¡€JSONæ—¥å¿—ç”Ÿæˆ

# è½¬ä¹‰JSONå­—ç¬¦ä¸²
json_escape() {
    local string=$1
    # è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
    string=${string//\\/\\\\}  # åæ–œæ 
    string=${string//\"/\\\"}  # åŒå¼•å·  
    string=${string//	/\\t}   # åˆ¶è¡¨ç¬¦
    string=${string//
/\\n}   # æ¢è¡Œç¬¦
    string=${string///\\r}   # å›è½¦ç¬¦
    echo "$string"
}

# åŸºç¡€JSONæ—¥å¿—å‡½æ•°
json_log() {
    local level=$1
    local message=$2
    local component=${3:-"main"}
    
    local timestamp=$(date -u '+%Y-%m-%dT%H:%M:%S.%3NZ')
    local hostname=$(hostname)
    local pid=$$
    local user=$(whoami)
    
    # æ„å»ºJSONå¯¹è±¡
    cat << EOF
{
  "timestamp": "$timestamp",
  "level": "$level", 
  "message": "$(json_escape "$message")",
  "component": "$component",
  "hostname": "$hostname",
  "pid": $pid,
  "user": "$user"
}
EOF
}

# ä½¿ç”¨ç¤ºä¾‹
json_log "INFO" "åº”ç”¨ç¨‹åºå¯åŠ¨å®Œæˆ" "startup"
json_log "ERROR" "æ— æ³•è¿æ¥åˆ°æ•°æ®åº“ï¼šè¿æ¥è¢«æ‹’ç»" "database"
```

**é«˜çº§JSONæ—¥å¿—ç³»ç»Ÿ**ï¼š
```bash
#!/bin/bash
# é«˜çº§ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ

# JSONæ—¥å¿—æ„å»ºå™¨
json_log_builder() {
    local -A log_data
    local level=""
    local message=""
    
    # è§£æå‚æ•°
    while [[ $# -gt 0 ]]; do
        case $1 in
            --level) level="$2"; shift 2 ;;
            --message) message="$2"; shift 2 ;;
            --field) 
                local field_name="$2"
                local field_value="$3"
                log_data["$field_name"]="$field_value"
                shift 3
                ;;
            *) shift ;;
        esac
    done
    
    # åŸºç¡€å­—æ®µ
    local timestamp=$(date -u '+%Y-%m-%dT%H:%M:%S.%3NZ')
    local hostname=$(hostname)
    local script_name=$(basename "$0")
    
    # å¼€å§‹æ„å»ºJSON
    local json='{'
    json+='"timestamp":"'$timestamp'",'
    json+='"level":"'$level'",'  
    json+='"message":"'$(json_escape "$message")'",'
    json+='"hostname":"'$hostname'",'
    json+='"script":"'$script_name'",'
    json+='"pid":'$$
    
    # æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
    for field_name in "${!log_data[@]}"; do
        local field_value="${log_data[$field_name]}"
        
        # åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—
        if [[ "$field_value" =~ ^[0-9]+$ ]]; then
            json+=',"'$field_name'":'$field_value
        else
            json+=',"'$field_name'":"'$(json_escape "$field_value")'"'
        fi
    done
    
    json+='}'
    echo "$json"
}

# ä¾¿æ·å‡½æ•°
log_info_json() {
    json_log_builder --level "INFO" --message "$1" "${@:2}"
}

log_error_json() {
    json_log_builder --level "ERROR" --message "$1" "${@:2}"  
}

log_warn_json() {
    json_log_builder --level "WARN" --message "$1" "${@:2}"
}

# ä½¿ç”¨ç¤ºä¾‹
log_info_json "ç”¨æˆ·ç™»å½•æˆåŠŸ" \
    --field "user_id" "12345" \
    --field "username" "admin" \
    --field "source_ip" "192.168.1.100" \
    --field "response_time" "120"

log_error_json "æ•°æ®åº“æŸ¥è¯¢å¤±è´¥" \
    --field "query" "SELECT * FROM users" \
    --field "error_code" "1045" \
    --field "error_message" "Access denied"
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```json
{
  "timestamp": "2025-01-21T10:30:15.123Z",
  "level": "INFO",
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ", 
  "hostname": "web-server-01",
  "script": "login.sh",
  "pid": 12345,
  "user_id": 12345,
  "username": "admin",
  "source_ip": "192.168.1.100",
  "response_time": 120
}
```

### 6.3 å¤æ‚æ•°æ®ç»“æ„çš„JSONæ—¥å¿—


```bash
#!/bin/bash
# å¤„ç†å¤æ‚æ•°æ®ç»“æ„çš„JSONæ—¥å¿—

# è®°å½•HTTPè¯·æ±‚çš„å®Œæ•´ä¿¡æ¯
log_http_request() {
    local method=$1
    local url=$2  
    local status_code=$3
    local response_time=$4
    local user_agent=$5
    
    local timestamp=$(date -u '+%Y-%m-%dT%H:%M:%S.%3NZ')
    
    # è§£æURLè·å–æ›´å¤šä¿¡æ¯
    local domain=$(echo "$url" | sed -n 's|.*//\([^/]*\).*|\1|p')
    local path=$(echo "$url" | sed -n 's|.*//[^/]*\(.*\)|\1|p')
    
    cat << EOF | jq -c .
{
  "timestamp": "$timestamp",
  "level": "INFO",
  "event_type": "http_request", 
  "request": {
    "method": "$method",
    "url": "$url",
    "domain": "$domain", 
    "path": "$path",
    "user_agent": "$user_agent"
  },
  "response": {
    "status_code": $status_code,
    "response_time_ms": $response_time
  },
  "server": {
    "hostname": "$(hostname)",
    "pid": $$
  }
}
EOF
}

# è®°å½•ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
log_system_metrics() {
    local timestamp=$(date -u '+%Y-%m-%dT%H:%M:%S.%3NZ')
    
    # è·å–ç³»ç»ŸæŒ‡æ ‡
    local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | sed 's/%us,//')
    local memory_usage=$(free | grep Mem | awk '{printf "%.1f", $3/$2 * 100.0}')
    local disk_usage=$(df -h / | awk 'NR==2{print $5}' | sed 's/%//')
    local load_average=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | sed 's/,//')
    
    cat << EOF | jq -c .
{
  "timestamp": "$timestamp",
  "level": "INFO", 
  "event_type": "system_metrics",
  "hostname": "$(hostname)",
  "metrics": {
    "cpu_usage_percent": $cpu_usage,
    "memory_usage_percent": $memory_usage,
    "disk_usage_percent": $disk_usage,
    "load_average_1min": $load_average
  }
}
EOF
}

# ä½¿ç”¨ç¤ºä¾‹
log_http_request "GET" "https://api.example.com/users/123" "200" "150" "curl/7.68.0"
log_system_metrics
```

---

## 7. ğŸ” æ—¥å¿—è¿‡æ»¤ä¸æ£€ç´¢ä¼˜åŒ–


### 7.1 é«˜æ•ˆæ—¥å¿—æ£€ç´¢ç­–ç•¥


**æ£€ç´¢åœºæ™¯åˆ†ç±»**ï¼š
```
å®æ—¶ç›‘æ§ï¼štail -f app.log | grep ERROR
å†å²æŸ¥è¯¢ï¼šgrep "2025-01-21" app.log* | grep "login failed"  
æ‰¹é‡åˆ†æï¼šfind /var/log -name "*.log" -exec grep "database error" {} \;
å¤æ‚æœç´¢ï¼šawk + sed + grep ç»„åˆæŸ¥è¯¢

ä¼˜åŒ–åŸåˆ™ï¼š
ğŸ” ä½¿ç”¨åˆé€‚çš„å·¥å…·ï¼ˆgrep/awk/sedï¼‰
ğŸ“Š å»ºç«‹ç´¢å¼•æ–‡ä»¶åŠ é€ŸæŸ¥è¯¢
ğŸ—‚ï¸ æŒ‰æ—¶é—´/çº§åˆ«åˆ†ç±»å­˜å‚¨  
âš¡ é¿å…å…¨é‡æ‰«æå¤§æ–‡ä»¶
```

### 7.2 æ™ºèƒ½æ—¥å¿—è¿‡æ»¤å™¨


```bash
#!/bin/bash
# æ™ºèƒ½æ—¥å¿—è¿‡æ»¤å’Œæœç´¢å·¥å…·

# å¤šæ¡ä»¶æ—¥å¿—è¿‡æ»¤
filter_logs() {
    local log_file=$1
    local -A filters
    local output_format="text"
    
    # è§£æè¿‡æ»¤æ¡ä»¶
    shift
    while [[ $# -gt 0 ]]; do
        case $1 in
            --level) filters["level"]="$2"; shift 2 ;;
            --date) filters["date"]="$2"; shift 2 ;;  
            --component) filters["component"]="$2"; shift 2 ;;
            --message) filters["message"]="$2"; shift 2 ;;
            --format) output_format="$2"; shift 2 ;;
            *) shift ;;
        esac
    done
    
    # æ„å»ºgrepå‘½ä»¤
    local grep_cmd="cat $log_file"
    
    # æ·»åŠ è¿‡æ»¤æ¡ä»¶
    if [[ -n "${filters[date]}" ]]; then
        grep_cmd+=" | grep '${filters[date]}'"
    fi
    
    if [[ -n "${filters[level]}" ]]; then
        grep_cmd+=" | grep '\\[${filters[level]}\\]'"
    fi
    
    if [[ -n "${filters[component]}" ]]; then
        grep_cmd+=" | grep '\\[${filters[component]}\\]'"  
    fi
    
    if [[ -n "${filters[message]}" ]]; then
        grep_cmd+=" | grep -i '${filters[message]}'"
    fi
    
    # æ‰§è¡Œè¿‡æ»¤
    case $output_format in
        "json")
            eval "$grep_cmd" | convert_to_json
            ;;
        "summary") 
            eval "$grep_cmd" | summarize_logs
            ;;
        *)
            eval "$grep_cmd"
            ;;
    esac
}

# æ—¥å¿—æ‘˜è¦ç»Ÿè®¡
summarize_logs() {
    local temp_file=$(mktemp)
    cat > "$temp_file"
    
    echo "=== æ—¥å¿—æ‘˜è¦ç»Ÿè®¡ ==="
    echo "æ€»è¡Œæ•°: $(wc -l < "$temp_file")"
    
    echo -e "\n=== çº§åˆ«åˆ†å¸ƒ ==="
    grep -o '\[ERROR\]\|\[WARN\]\|\[INFO\]\|\[DEBUG\]' "$temp_file" | sort | uniq -c | sort -nr
    
    echo -e "\n=== æ—¶é—´èŒƒå›´ ==="
    local first_line=$(head -n1 "$temp_file" | grep -o '[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\} [0-9]\{2\}:[0-9]\{2\}:[0-9]\{2\}')
    local last_line=$(tail -n1 "$temp_file" | grep -o '[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\} [0-9]\{2\}:[0-9]\{2\}:[0-9]\{2\}')
    echo "å¼€å§‹æ—¶é—´: $first_line"
    echo "ç»“æŸæ—¶é—´: $last_line"
    
    echo -e "\n=== æœ€æ–°10æ¡è®°å½• ==="
    tail -n10 "$temp_file"
    
    rm -f "$temp_file"
}

# ä½¿ç”¨ç¤ºä¾‹
filter_logs "/var/log/app.log" --level "ERROR" --date "2025-01-21" --format "summary"
filter_logs "/var/log/app.log" --component "DATABASE" --message "connection"
```

### 7.3 é«˜æ€§èƒ½æ—¥å¿—æœç´¢


```bash
#!/bin/bash
# é«˜æ€§èƒ½æ—¥å¿—æœç´¢å·¥å…·

# å»ºç«‹æ—¥å¿—ç´¢å¼•
build_log_index() {
    local log_file=$1
    local index_dir="${log_file}.index"
    
    echo "æ­£åœ¨ä¸º $log_file å»ºç«‹ç´¢å¼•..."
    mkdir -p "$index_dir"
    
    # æŒ‰æ—¥æœŸå»ºç«‹ç´¢å¼•
    awk '{print substr($0, 2, 10)}' "$log_file" | sort -u > "${index_dir}/dates.idx"
    
    # æŒ‰çº§åˆ«å»ºç«‹ç´¢å¼•  
    grep -n '\[ERROR\]' "$log_file" > "${index_dir}/error.idx" &
    grep -n '\[WARN\]' "$log_file" > "${index_dir}/warn.idx" &
    grep -n '\[INFO\]' "$log_file" > "${index_dir}/info.idx" &
    wait
    
    # æŒ‰å…³é”®è¯å»ºç«‹ç´¢å¼•
    grep -n -i 'database\|connection\|timeout\|failed' "$log_file" > "${index_dir}/keywords.idx"
    
    echo "ç´¢å¼•å»ºç«‹å®Œæˆ: $index_dir"
}

# åŸºäºç´¢å¼•çš„å¿«é€Ÿæœç´¢
indexed_search() {
    local log_file=$1
    local search_type=$2
    local search_value=$3
    local index_dir="${log_file}.index"
    
    if [[ ! -d "$index_dir" ]]; then
        echo "ç´¢å¼•ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ: build_log_index $log_file"
        return 1
    fi
    
    local line_numbers=""
    
    case $search_type in
        "level")
            if [[ -f "${index_dir}/${search_value,,}.idx" ]]; then
                line_numbers=$(cut -d: -f1 "${index_dir}/${search_value,,}.idx")
            fi
            ;;
        "date")
            line_numbers=$(grep -n "\\[$search_value" "$log_file" | cut -d: -f1)
            ;;
        "keyword")
            line_numbers=$(grep -n -i "$search_value" "${index_dir}/keywords.idx" | cut -d: -f1)
            ;;
    esac
    
    # æ ¹æ®è¡Œå·å¿«é€Ÿæå–å†…å®¹
    if [[ -n "$line_numbers" ]]; then
        echo "$line_numbers" | while read -r line_num; do
            sed -n "${line_num}p" "$log_file"
        done
    else
        echo "æœªæ‰¾åˆ°åŒ¹é…çš„è®°å½•"
    fi
}

# å®æ—¶æ—¥å¿—ç›‘æ§withè¿‡æ»¤
monitor_logs() {
    local log_file=$1
    local filter_pattern=$2
    local alert_threshold=${3:-10}  # é»˜è®¤10æ¬¡è§¦å‘å‘Šè­¦
    
    local count=0
    local start_time=$(date +%s)
    
    echo "å¼€å§‹ç›‘æ§æ—¥å¿—æ–‡ä»¶: $log_file"
    echo "è¿‡æ»¤æ¨¡å¼: $filter_pattern"
    echo "å‘Šè­¦é˜ˆå€¼: $alert_threshold æ¬¡/åˆ†é’Ÿ"
    
    tail -F "$log_file" | while read -r line; do
        if echo "$line" | grep -q "$filter_pattern"; then
            echo "[$(date '+%H:%M:%S')] åŒ¹é…: $line"
            
            ((count++))
            current_time=$(date +%s)
            
            # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°å‘Šè­¦é˜ˆå€¼
            if [[ $count -ge $alert_threshold ]]; then
                local elapsed=$((current_time - start_time))
                if [[ $elapsed -le 60 ]]; then
                    echo "âš ï¸ å‘Šè­¦: $filter_pattern åœ¨1åˆ†é’Ÿå†…å‡ºç° $count æ¬¡!"
                    # è¿™é‡Œå¯ä»¥æ·»åŠ å‘Šè­¦é€šçŸ¥é€»è¾‘
                fi
                count=0
                start_time=$current_time
            fi
        fi
    done
}

# ä½¿ç”¨ç¤ºä¾‹
build_log_index "/var/log/app.log"
indexed_search "/var/log/app.log" "level" "ERROR"  
monitor_logs "/var/log/app.log" "connection failed" 5
```

### 7.4 æ—¥å¿—æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§


**å¸¸ç”¨æ£€ç´¢å‘½ä»¤ä¼˜åŒ–**ï¼š
```bash
# ğŸ“Š æ€§èƒ½å¯¹æ¯”ï¼šä¸åŒæœç´¢æ–¹å¼çš„æ•ˆç‡

# âŒ ä½æ•ˆæ–¹å¼ï¼šå…¨æ–‡æœç´¢å¤§æ–‡ä»¶
grep "ERROR" huge_log.log                    # æ…¢ï¼Œéœ€è¦æ‰«ææ•´ä¸ªæ–‡ä»¶

# âœ… é«˜æ•ˆæ–¹å¼1ï¼šé™åˆ¶æ—¶é—´èŒƒå›´
sed -n '/2025-01-21 10:00/,/2025-01-21 11:00/p' huge_log.log | grep "ERROR"

# âœ… é«˜æ•ˆæ–¹å¼2ï¼šä½¿ç”¨awkè¿‡æ»¤
awk '/2025-01-21 10:/ && /ERROR/ {print}' huge_log.log

# âœ… é«˜æ•ˆæ–¹å¼3ï¼šå¤šçº§è¿‡æ»¤  
grep "2025-01-21 10:" huge_log.log | grep "ERROR" | head -20

# âœ… é«˜æ•ˆæ–¹å¼4ï¼šå¹¶è¡Œæœç´¢
parallel grep "ERROR" ::: log_file_*.log
```

**å¤æ‚æŸ¥è¯¢ç¤ºä¾‹**ï¼š
```bash
# æŸ¥æ‰¾ç‰¹å®šæ—¶é—´æ®µå†…çš„é”™è¯¯æ—¥å¿—ï¼Œå¹¶æŒ‰å‡ºç°é¢‘æ¬¡æ’åº
awk '/2025-01-21 [09-11]:/ && /ERROR/ {
    match($0, /ERROR: (.*)/, arr)
    if (arr[1]) errors[arr[1]]++
} 
END {
    for (error in errors) 
        printf "%d: %s\n", errors[error], error
}' app.log | sort -nr

# åˆ†æç”¨æˆ·ç™»å½•å¤±è´¥æ¨¡å¼
grep "login failed" auth.log | \
awk '{print $8}' | \  # æå–IPåœ°å€
sort | uniq -c | \     # ç»Ÿè®¡é¢‘æ¬¡
sort -nr | \           # æŒ‰æ¬¡æ•°é™åº
head -10               # æ˜¾ç¤ºå‰10å

# è®¡ç®—APIå“åº”æ—¶é—´ç»Ÿè®¡
awk '/API response/ {
    match($0, /time: ([0-9]+)ms/, arr)
    if (arr[1]) {
        times[++i] = arr[1]
        sum += arr[1]
    }
}
END {
    asort(times)
    avg = sum/i
    median = (i%2) ? times[(i+1)/2] : (times[i/2] + times[i/2+1])/2
    printf "æ€»æ•°: %d, å¹³å‡: %.1fms, ä¸­ä½æ•°: %.1fms\n", i, avg, median
}' api.log
```

---

## 8. ğŸ“Š æ€§èƒ½æ—¥å¿—ä¸ç›‘æ§æ•°æ®


### 8.1 ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ç›‘æ§


**æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡**ï¼š
```
CPUä½¿ç”¨ç‡ï¼š    è¡¡é‡å¤„ç†å™¨è´Ÿè½½
å†…å­˜ä½¿ç”¨ç‡ï¼š    è¡¡é‡å†…å­˜å‹åŠ›  
ç£ç›˜I/Oï¼š     è¡¡é‡ç£ç›˜è¯»å†™æ€§èƒ½
ç½‘ç»œæµé‡ï¼š     è¡¡é‡ç½‘ç»œè´Ÿè½½
è¿›ç¨‹çŠ¶æ€ï¼š     ç›‘æ§å…³é”®è¿›ç¨‹è¿è¡Œæƒ…å†µ
```

```bash
#!/bin/bash
# ç³»ç»Ÿæ€§èƒ½ç›‘æ§è„šæœ¬

# æ€§èƒ½æ•°æ®é‡‡é›†å‡½æ•°
collect_performance_metrics() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local hostname=$(hostname)
    
    # CPUä½¿ç”¨ç‡
    local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2+$4}')
    
    # å†…å­˜ä½¿ç”¨æƒ…å†µ  
    local memory_info=$(free -m | grep "Mem:")
    local memory_total=$(echo $memory_info | awk '{print $2}')
    local memory_used=$(echo $memory_info | awk '{print $3}')
    local memory_usage=$(awk "BEGIN {printf \"%.1f\", $memory_used/$memory_total*100}")
    
    # ç£ç›˜ä½¿ç”¨æƒ…å†µ
    local disk_usage=$(df -h / | awk 'NR==2{print $5}' | sed 's/%//')
    
    # è´Ÿè½½å¹³å‡å€¼
    local load_avg=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | sed 's/,//')
    
    # ç½‘ç»œè¿æ¥æ•°
    local tcp_connections=$(ss -t | wc -l)
    
    # è¾“å‡ºæ€§èƒ½æ—¥å¿—
    printf "[%s] PERF: CPU=%.1f%% MEM=%.1f%% DISK=%d%% LOAD=%.2f TCP=%d HOST=%s\n" \
           "$timestamp" "$cpu_usage" "$memory_usage" "$disk_usage" "$load_avg" "$tcp_connections" "$hostname"
}

# æŒç»­æ€§èƒ½ç›‘æ§
continuous_monitoring() {
    local interval=${1:-60}  # é»˜è®¤60ç§’é—´éš”
    local log_file=${2:-"/var/log/performance.log"}
    
    echo "å¼€å§‹æ€§èƒ½ç›‘æ§ï¼Œé—´éš”: ${interval}ç§’ï¼Œæ—¥å¿—æ–‡ä»¶: $log_file"
    
    while true; do
        collect_performance_metrics >> "$log_file"
        sleep "$interval"
    done
}

# æ€§èƒ½å‘Šè­¦æ£€æŸ¥
check_performance_alerts() {
    local cpu_threshold=${1:-80}
    local memory_threshold=${2:-85}  
    local disk_threshold=${3:-90}
    
    local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2+$4}' | cut -d'%' -f1)
    local memory_usage=$(free | grep Mem | awk '{printf "%.0f", $3/$2 * 100.0}')
    local disk_usage=$(df -h / | awk 'NR==2{print $5}' | sed 's/%//')
    
    # CPUå‘Šè­¦
    if (( $(echo "$cpu_usage > $cpu_threshold" | bc -l) )); then
        echo "ğŸš¨ CPUä½¿ç”¨ç‡å‘Šè­¦: å½“å‰${cpu_usage}% è¶…è¿‡é˜ˆå€¼${cpu_threshold}%"
    fi
    
    # å†…å­˜å‘Šè­¦  
    if [[ $memory_usage -gt $memory_threshold ]]; then
        echo "ğŸš¨ å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦: å½“å‰${memory_usage}% è¶…è¿‡é˜ˆå€¼${memory_threshold}%"
    fi
    
    # ç£ç›˜å‘Šè­¦
    if [[ $disk_usage -gt $disk_threshold ]]; then
        echo "ğŸš¨ ç£ç›˜ä½¿ç”¨ç‡å‘Šè­¦: å½“å‰${disk_usage}% è¶…è¿‡é˜ˆå€¼${disk_threshold}%"
    fi
}

# æ€§èƒ½è¶‹åŠ¿åˆ†æ
analyze_performance_trend() {
    local log_file=$1
    local hours=${2:-24}  # åˆ†ææœ€è¿‘24å°æ—¶
    
    echo "=== æ€§èƒ½è¶‹åŠ¿åˆ†æï¼ˆæœ€è¿‘${hours}å°æ—¶ï¼‰ ==="
    
    # æå–æœ€è¿‘Nå°æ—¶çš„æ•°æ®
    local since_time=$(date -d "$hours hours ago" '+%Y-%m-%d %H:%M:%S')
    local temp_data=$(mktemp)
    
    awk -v since="$since_time" '$0 >= "["since {print}' "$log_file" > "$temp_data"
    
    if [[ ! -s "$temp_data" ]]; then
        echo "æ²¡æœ‰æ‰¾åˆ°æ—¶é—´èŒƒå›´å†…çš„æ€§èƒ½æ•°æ®"
        rm -f "$temp_data"
        return 1
    fi
    
    # CPUä½¿ç”¨ç‡ç»Ÿè®¡
    echo "ğŸ“Š CPUä½¿ç”¨ç‡:"
    awk '{match($0, /CPU=([0-9.]+)%/, arr); if(arr[1]) print arr[1]}' "$temp_data" | \
    awk '{sum+=$1; if($1>max) max=$1; if(min=="" || $1<min) min=$1; count++} 
         END{printf "  å¹³å‡: %.1f%%  æœ€å¤§: %.1f%%  æœ€å°: %.1f%%\n", sum/count, max, min}'
    
    # å†…å­˜ä½¿ç”¨ç‡ç»Ÿè®¡
    echo "ğŸ“Š å†…å­˜ä½¿ç”¨ç‡:"
    awk '{match($0, /MEM=([0-9.]+)%/, arr); if(arr[1]) print arr[1]}' "$temp_data" | \
    awk '{sum+=$1; if($1>max) max=$1; if(min=="" || $1<min) min=$1; count++} 
         END{printf "  å¹³å‡: %.1f%%  æœ€å¤§: %.1f%%  æœ€å°: %.1f%%\n", sum/count, max, min}'
    
    # ç£ç›˜ä½¿ç”¨ç‡ç»Ÿè®¡  
    echo "ğŸ“Š ç£ç›˜ä½¿ç”¨ç‡:"
    awk '{match($0, /DISK=([0-9]+)%/, arr); if(arr[1]) print arr[1]}' "$temp_data" | \
    awk '{sum+=$1; if($1>max) max=$1; if(min=="" || $1<min) min=$1; count++} 
         END{printf "  å¹³å‡: %.0f%%  æœ€å¤§: %.0f%%  æœ€å°: %.0f%%\n", sum/count, max, min}'
    
    rm -f "$temp_data"
}

# ä½¿ç”¨ç¤ºä¾‹
collect_performance_metrics
continuous_monitoring 30 "/var/log/perf.log" &
check_performance_alerts 80 85 90
analyze_performance_trend "/var/log/perf.log" 24
```

### 8.2 åº”ç”¨ç¨‹åºæ€§èƒ½ç›‘æ§


```bash
#!/bin/bash
# åº”ç”¨ç¨‹åºæ€§èƒ½ç›‘æ§

# å‡½æ•°æ‰§è¡Œæ—¶é—´ç›‘æ§
time_function() {
    local func_name=$1
    shift
    local start_time=$(date +%s%N)
    
    # æ‰§è¡Œå‡½æ•°
    "$@"
    local exit_code=$?
    
    local end_time=$(date +%s%N)
    local duration=$(( (end_time - start_time) / 1000000 ))  # è½¬æ¢ä¸ºæ¯«ç§’
    
    log_performance "$func_name" "$duration" "$exit_code"
    
    return $exit_code
}

# æ€§èƒ½æ—¥å¿—è®°å½•
log_performance() {
    local operation=$1
    local duration_ms=$2
    local status=${3:-"success"}
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S.%3N')
    
    # æ ¹æ®æ‰§è¡Œæ—¶é—´è®¾å®šçº§åˆ«
    local level="INFO"
    if [[ $duration_ms -gt 5000 ]]; then
        level="WARN"  # è¶…è¿‡5ç§’è­¦å‘Š
    elif [[ $duration_ms -gt 10000 ]]; then
        level="ERROR" # è¶…è¿‡10ç§’é”™è¯¯
    fi
    
    printf "[%s] [%s] PERFORMANCE: operation=%s duration=%dms status=%s\n" \
           "$timestamp" "$level" "$operation" "$duration_ms" "$status"
}

# æ•°æ®åº“æ“ä½œç›‘æ§ç¤ºä¾‹
monitor_database_query() {
    local query=$1
    local db_name=${2:-"default"}
    
    echo "æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ç›‘æ§: $query"
    
    # æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢ï¼ˆå®é™…åº”ç”¨ä¸­æ›¿æ¢ä¸ºçœŸå®çš„æ•°æ®åº“å‘½ä»¤ï¼‰
    time_function "db_query_${db_name}" simulate_db_query "$query"
}

simulate_db_query() {
    local query=$1
    # æ¨¡æ‹ŸæŸ¥è¯¢æ‰§è¡Œæ—¶é—´
    sleep $(( (RANDOM % 3) + 1 ))
    
    # æ¨¡æ‹Ÿå¶å°”çš„æŸ¥è¯¢å¤±è´¥
    if [[ $((RANDOM % 10)) -eq 0 ]]; then
        echo "æŸ¥è¯¢å¤±è´¥: $query" >&2
        return 1
    fi
    
    echo "æŸ¥è¯¢æˆåŠŸ: $query"
    return 0
}

# æ–‡ä»¶å¤„ç†æ€§èƒ½ç›‘æ§
monitor_file_processing() {
    local file_path=$1
    local operation=${2:-"process"}
    
    if [[ ! -f "$file_path" ]]; then
        log_performance "file_${operation}" "0" "file_not_found"
        return 1
    fi
    
    local file_size=$(stat -f%z "$file_path" 2>/dev/null || stat -c%s "$file_path")
    
    time_function "file_${operation}" process_file_content "$file_path"
    
    # è®°å½•æ–‡ä»¶å¤§å°ä¿¡æ¯
    echo "æ–‡ä»¶å¤„ç†å®Œæˆ: $file_path (å¤§å°: $file_size å­—èŠ‚)"
}

process_file_content() {
    local file_path=$1
    # æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†
    wc -l "$file_path" > /dev/null
    grep -c "error" "$file_path" 2>/dev/null || true
}

# æ‰¹é‡æ“ä½œæ€§èƒ½ç»Ÿè®¡
batch_performance_stats() {
    local operations=("$@")
    local total_start=$(date +%s%N)
    local success_count=0
    local error_count=0
    
    echo "å¼€å§‹æ‰¹é‡æ“ä½œæ€§èƒ½ç»Ÿè®¡..."
    
    for operation in "${operations[@]}"; do
        if time_function "batch_operation" eval "$operation"; then
            ((success_count++))
        else
            ((error_count++))
        fi
    done
    
    local total_end=$(date +%s%N)
    local total_duration=$(( (total_end - total_start) / 1000000 ))
    local total_count=$((success_count + error_count))
    
    echo "=== æ‰¹é‡æ“ä½œç»Ÿè®¡ ==="
    echo "æ€»æ“ä½œæ•°: $total_count"
    echo "æˆåŠŸ: $success_count"
    echo "å¤±è´¥: $error_count"  
    echo "æ€»è€—æ—¶: ${total_duration}ms"
    echo "å¹³å‡è€—æ—¶: $((total_duration / total_count))ms/æ“ä½œ"
}

# ä½¿ç”¨ç¤ºä¾‹
monitor_database_query "SELECT * FROM users WHERE status='active'"
monitor_file_processing "/var/log/app.log" "analyze"
batch_performance_stats "ls -la" "ps aux" "df -h" "free -m"
```

---

## 9. ğŸ”’ æ—¥å¿—å®‰å…¨ä¸æ•æ„Ÿä¿¡æ¯è„±æ•


### 9.1 æ•æ„Ÿä¿¡æ¯è¯†åˆ«ä¸é£é™©


**å¸¸è§æ•æ„Ÿä¿¡æ¯ç±»å‹**ï¼š
```
ğŸ” èº«ä»½è®¤è¯ä¿¡æ¯ï¼š
   - ç”¨æˆ·å¯†ç ã€APIå¯†é’¥ã€ä»¤ç‰Œ
   - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
   - SSHç§é’¥ã€è¯ä¹¦ä¿¡æ¯

ğŸ’³ ä¸ªäººéšç§ä¿¡æ¯ï¼š  
   - èº«ä»½è¯å·ã€æŠ¤ç…§å·ç 
   - é“¶è¡Œè´¦å·ã€ä¿¡ç”¨å¡å·
   - æ‰‹æœºå·ç ã€é‚®ç®±åœ°å€

ğŸ¢ å•†ä¸šæœºå¯†ä¿¡æ¯ï¼š
   - å†…éƒ¨IPåœ°å€ã€æœåŠ¡å™¨é…ç½®  
   - ä¸šåŠ¡æ•°æ®ã€ç”¨æˆ·ç»Ÿè®¡
   - ç³»ç»Ÿæ¶æ„ã€ä»£ç ç‰‡æ®µ
```

**å®‰å…¨é£é™©åˆ†æ**ï¼š
```
é£é™©åœºæ™¯ï¼š
âŒ æ—¥å¿—æ–‡ä»¶è¢«æœªæˆæƒè®¿é—®
âŒ æ—¥å¿—ä¼ è¾“è¿‡ç¨‹ä¸­è¢«æˆªè·
âŒ æ—¥å¿—å¤‡ä»½æ–‡ä»¶æ³„éœ²
âŒ å¼€å‘äººå‘˜æ„å¤–æš´éœ²æ•æ„Ÿæ—¥å¿—

åæœå½±å“ï¼š
ğŸš¨ ç”¨æˆ·éšç§æ³„éœ²
ğŸš¨ ç³»ç»Ÿè¢«æ¶æ„æ”»å‡»  
ğŸš¨ å•†ä¸šæœºå¯†å¤–æ³„
ğŸš¨ æ³•å¾‹åˆè§„é—®é¢˜
```

### 9.2 æ•æ„Ÿä¿¡æ¯è„±æ•æŠ€æœ¯


**è„±æ•ç­–ç•¥åˆ†ç±»**ï¼š
```
ğŸ”¹ å®Œå…¨éšè—ï¼š    *** 
ğŸ”¹ éƒ¨åˆ†éšè—ï¼š    138****1234
ğŸ”¹ å“ˆå¸Œæ›¿æ¢ï¼š    SHA256(åŸå§‹æ•°æ®)
ğŸ”¹ æ ¼å¼ä¿ç•™ï¼š    ä¿æŒåŸæ ¼å¼ä½†æ›¿æ¢å†…å®¹
ğŸ”¹ èŒƒå›´æ›¿æ¢ï¼š    å…·ä½“æ•°å€¼æ›¿æ¢ä¸ºèŒƒå›´
```

```bash
#!/bin/bash
# æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†å‡½æ•°

# æ‰‹æœºå·è„±æ•
mask_phone() {
    local phone=$1
    echo "$phone" | sed -E 's/([0-9]{3})[0-9]{4}([0-9]{4})/\1****\2/'
}

# èº«ä»½è¯å·è„±æ•  
mask_id_card() {
    local id_card=$1
    echo "$id_card" | sed -E 's/([0-9]{6})[0-9]{8}([0-9]{4})/\1********\2/'
}

# é‚®ç®±åœ°å€è„±æ•
mask_email() {
    local email=$1
    echo "$email" | sed -E 's/^(.{2})[^@]*(.{2})(@.*)$/\1****\2\3/'
}

# IPåœ°å€è„±æ•
mask_ip() {
    local ip=$1
    echo "$ip" | sed -E 's/([0-9]+\.[0-9]+)\.[0-9]+\.[0-9]+/\1.*.*/g'
}

# å¯†ç å®Œå…¨éšè—
mask_password() {
    local password=$1
    local length=${#password}
    printf '%*s' "$length" '' | tr ' ' '*'
}

# é“¶è¡Œå¡å·è„±æ•
mask_bank_card() {
    local card=$1
    local card_clean=$(echo "$card" | tr -d ' -')
    local length=${#card_clean}
    
    if [[ $length -ge 8 ]]; then
        local prefix=${card_clean:0:4}
        local suffix=${card_clean: -4}
        local middle_length=$((length - 8))
        local middle=$(printf '%*s' "$middle_length" '' | tr ' ' '*')
        echo "${prefix}${middle}${suffix}"
    else
        printf '%*s' "$length" '' | tr ' ' '*'
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
mask_phone "13812345678"        # è¾“å‡º: 138****5678
mask_email "user@example.com"   # è¾“å‡º: us****om@example.com
mask_id_card "110101199001011234" # è¾“å‡º: 110101********1234
```

### 9.3 æ™ºèƒ½è„±æ•ç³»ç»Ÿ


```bash
#!/bin/bash
# æ™ºèƒ½æ—¥å¿—è„±æ•ç³»ç»Ÿ

# æ•æ„Ÿä¿¡æ¯æ¨¡å¼å®šä¹‰
declare -A SENSITIVE_PATTERNS=(
    ["phone"]='[0-9]{11}'
    ["email"]='[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
    ["ip"]='[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'
    ["id_card"]='[0-9]{15}|[0-9]{17}[0-9Xx]'
    ["password"]='password[[:space:]]*[:=][[:space:]]*[^[:space:]]+'
    ["token"]='token[[:space:]]*[:=][[:space:]]*[a-zA-Z0-9+/=]+'
)

# æ™ºèƒ½æ£€æµ‹å¹¶è„±æ•
intelligent_mask() {
    local text=$1
    local masked_text="$text"
    
    # æ£€æµ‹å¹¶è„±æ•æ‰‹æœºå·
    if echo "$text" | grep -qE "${SENSITIVE_PATTERNS[phone]}"; then
        masked_text=$(echo "$masked_text" | sed -E "s/${SENSITIVE_PATTERNS[phone]}/$(mask_phone_pattern)/g")
    fi
    
    # æ£€æµ‹å¹¶è„±æ•é‚®ç®±
    if echo "$text" | grep -qE "${SENSITIVE_PATTERNS[email]}"; then
        masked_text=$(echo "$masked_text" | perl -pe 's/'${SENSITIVE_PATTERNS[email]}'/mask_email_pattern(**å®‰å…¨é£é™©åˆ†æ**ï¼š
```
é£é™©åœºæ™¯ï¼š
âŒ æ—¥å¿—æ–‡ä»¶è¢«æœªæˆæƒè®¿é—®
âŒ)/ge')
    fi
    
    # æ£€æµ‹å¹¶è„±æ•IPåœ°å€
    if echo "$text" | grep -qE "${SENSITIVE_PATTERNS[ip]}"; then
        masked_text=$(echo "$masked_text" | sed -E "s/${SENSITIVE_PATTERNS[ip]}/***.***.***.***g")
    fi
    
    # æ£€æµ‹å¹¶è„±æ•å¯†ç 
    if echo "$text" | grep -qiE "${SENSITIVE_PATTERNS[password]}"; then
        masked_text=$(echo "$masked_text" | sed -E 's/(password[[:space:]]*[:=][[:space:]]*)[^[:space:]]+/\1***/gi')
    fi
    
    echo "$masked_text"
}

mask_phone_pattern() {
    echo "***-****-****"
}

# æ‰¹é‡è„±æ•å¤„ç†
batch_mask_file() {
    local input_file=$1
    local output_file=$2
    local backup_original=${3:-true}
    
    if [[ ! -f "$input_file" ]]; then
        echo "é”™è¯¯: è¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨: $input_file"
        return 1
    fi
    
    # å¤‡ä»½åŸæ–‡ä»¶
    if [[ "$backup_original" == "true" ]]; then
        cp "$input_file" "${input_file}.backup.$(date +%Y%m%d_%H%M%S)"
        echo "åŸæ–‡ä»¶å·²å¤‡ä»½ä¸º: ${input_file}.backup.$(date +%Y%m%d_%H%M%S)"
    fi
    
    echo "å¼€å§‹è„±æ•å¤„ç†: $input_file -> $output_file"
    
    local line_count=0
    local masked_count=0
    
    while IFS= read -r line; do
        ((line_count++))
        local masked_line=$(intelligent_mask "$line")
        
        if [[ "$line" != "$masked_line" ]]; then
            ((masked_count++))
        fi
        
        echo "$masked_line" >> "$output_file"
        
        # æ˜¾ç¤ºè¿›åº¦
        if [[ $((line_count % 1000)) -eq 0 ]]; then
            echo "å·²å¤„ç† $line_count è¡Œï¼Œè„±æ• $masked_count è¡Œ"
        fi
    done < "$input_file"
    
    echo "è„±æ•å®Œæˆ: æ€»è®¡ $line_count è¡Œï¼Œè„±æ• $masked_count è¡Œ"
}

# å®æ—¶è„±æ•æ—¥å¿—è¾“å‡º
secure_log() {
    local level=$1
    local message=$2
    local enable_masking=${3:-true}
    
    if [[ "$enable_masking" == "true" ]]; then
        message=$(intelligent_mask "$message")
    fi
    
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    printf "[%s] [%s] %s\n" "$timestamp" "$level" "$message"
}

# ä½¿ç”¨ç¤ºä¾‹
secure_log "INFO" "ç”¨æˆ·ç™»å½•: user@example.com, IP: 192.168.1.100" true
batch_mask_file "/var/log/app.log" "/var/log/app_masked.log" true
```

### 9.4 æ—¥å¿—è®¿é—®æ§åˆ¶


```bash
#!/bin/bash
# æ—¥å¿—æ–‡ä»¶è®¿é—®æ§åˆ¶å’Œå®‰å…¨ç®¡ç†

# è®¾ç½®å®‰å…¨çš„æ—¥å¿—æ–‡ä»¶æƒé™
secure_log_permissions() {
    local log_file=$1
    local owner=${2:-"root"}
    local group=${3:-"log"}
    local mode=${4:-"640"}  # é»˜è®¤ï¼šæ‰€æœ‰è€…è¯»å†™ï¼Œç»„è¯»å–ï¼Œå…¶ä»–æ— æƒé™
    
    if [[ ! -f "$log_file" ]]; then
        echo "åˆ›å»ºæ—¥å¿—æ–‡ä»¶: $log_file"
        touch "$log_file"
    fi
    
    # è®¾ç½®æ‰€æœ‰è€…å’Œç»„
    chown "$owner:$group" "$log_file"
    
    # è®¾ç½®æƒé™
    chmod "$mode" "$log_file"
    
    echo "æ—¥å¿—æ–‡ä»¶å®‰å…¨æƒé™å·²è®¾ç½®: $log_file ($owner:$group $mode)"
}

# æ—¥å¿—æ–‡ä»¶åŠ å¯†å­˜å‚¨
encrypt_log_file() {
    local log_file=$1
    local encryption_key=${2:-"/etc/log_encryption.key"}
    local encrypted_file="${log_file}.encrypted"
    
    if [[ ! -f "$log_file" ]]; then
        echo "é”™è¯¯: æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨: $log_file"
        return 1
    fi
    
    # ä½¿ç”¨GPGåŠ å¯†ï¼ˆéœ€è¦é¢„å…ˆé…ç½®å¯†é’¥ï¼‰
    if command -v gpg &>/dev/null; then
        gpg --symmetric --cipher-algo AES256 --output "$encrypted_file" "$log_file"
        
        if [[ $? -eq 0 ]]; then
            echo "æ—¥å¿—æ–‡ä»¶åŠ å¯†å®Œæˆ: $encrypted_file"
            # å¯é€‰ï¼šåˆ é™¤åŸå§‹æ–‡ä»¶
            read -p "æ˜¯å¦åˆ é™¤åŸå§‹æ—¥å¿—æ–‡ä»¶? [y/N]: " -n 1 -r
            if [[ $REPLY =~ ^[Yy]$ ]]; then
                rm "$log_file"
                echo "åŸå§‹æ–‡ä»¶å·²åˆ é™¤"
            fi
        else
            echo "åŠ å¯†å¤±è´¥"
            return 1
        fi
    else
        echo "GPGæœªå®‰è£…ï¼Œæ— æ³•åŠ å¯†"
        return 1
    fi
}

# è§£å¯†æ—¥å¿—æ–‡ä»¶
decrypt_log_file() {
    local encrypted_file=$1
    local output_file=${2:-"${encrypted_file%.encrypted}"}
    
    if [[ ! -f "$encrypted_file" ]]; then
        echo "é”™è¯¯: åŠ å¯†æ–‡ä»¶ä¸å­˜åœ¨: $encrypted_file"
        return 1
    fi
    
    gpg --decrypt --output "$output_file" "$encrypted_file"
    
    if [[ $? -eq 0 ]]; then
        echo "æ—¥å¿—æ–‡ä»¶è§£å¯†å®Œæˆ: $output_file"
    else
        echo "è§£å¯†å¤±è´¥"
        return 1
    fi
}

# å®¡è®¡æ—¥å¿—è®¿é—®è®°å½•
audit_log_access() {
    local log_file=$1
    local audit_log="/var/log/log_access_audit.log"
    local user=$(whoami)
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local operation=${2:-"read"}
    
    # è®°å½•è®¿é—®å®¡è®¡
    echo "[$timestamp] USER:$user OPERATION:$operation FILE:$log_file" >> "$audit_log"
    
    # è®¾ç½®å®¡è®¡æ—¥å¿—æƒé™
    chmod 600 "$audit_log"
}

# å®‰å…¨æ—¥å¿—æŸ¥çœ‹å‡½æ•°
secure_view_log() {
    local log_file=$1
    local lines=${2:-50}
    
    # æ£€æŸ¥æ–‡ä»¶æƒé™
    if [[ ! -r "$log_file" ]]; then
        echo "é”™è¯¯: æ²¡æœ‰è¯»å–æƒé™: $log_file"
        audit_log_access "$log_file" "denied_read"
        return 1
    fi
    
    # è®°å½•è®¿é—®å®¡è®¡
    audit_log_access "$log_file" "read"
    
    # å®‰å…¨æŸ¥çœ‹ï¼ˆè‡ªåŠ¨è„±æ•ï¼‰
    echo "å®‰å…¨æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶: $log_file (æ˜¾ç¤ºæœ€å${lines}è¡Œ)"
    tail -n "$lines" "$log_file" | while IFS= read -r line; do
        intelligent_mask "$line"
    done
}

# æ—¥å¿—æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ
verify_log_integrity() {
    local log_file=$1
    local checksum_file="${log_file}.sha256"
    
    if [[ ! -f "$log_file" ]]; then
        echo "é”™è¯¯: æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨: $log_file"
        return 1
    fi
    
    # ç”Ÿæˆæ ¡éªŒå’Œ
    if [[ ! -f "$checksum_file" ]]; then
        echo "ç”Ÿæˆæ ¡éªŒå’Œæ–‡ä»¶: $checksum_file"
        sha256sum "$log_file" > "$checksum_file"
        chmod 600 "$checksum_file"
    else
        # éªŒè¯å®Œæ•´æ€§
        echo "éªŒè¯æ—¥å¿—æ–‡ä»¶å®Œæ•´æ€§..."
        if sha256sum -c "$checksum_file" &>/dev/null; then
            echo "âœ… æ—¥å¿—æ–‡ä»¶å®Œæ•´æ€§éªŒè¯é€šè¿‡"
        else
            echo "âŒ æ—¥å¿—æ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥ï¼å¯èƒ½è¢«ç¯¡æ”¹"
            audit_log_access "$log_file" "integrity_failure"
            return 1
        fi
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
secure_log_permissions "/var/log/secure_app.log" "appuser" "log" "640"
encrypt_log_file "/var/log/sensitive.log"
secure_view_log "/var/log/app.log" 20
verify_log_integrity "/var/log/critical.log"
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ æ—¥å¿—è®°å½•æœ¬è´¨ï¼šç¨‹åºè¿è¡Œçš„"æ—¥è®°æœ¬"ï¼Œè®°å½•è¿‡ç¨‹å’Œç»“æœ
ğŸ”¸ æ—¥å¿—çº§åˆ«ä½“ç³»ï¼šFATAL > ERROR > WARN > INFO > DEBUG > TRACE
ğŸ”¸ è¾“å‡ºæµæ§åˆ¶ï¼šstdout(1) stderr(2) é‡å®šå‘å’Œç®¡é“æ“ä½œ
ğŸ”¸ æ—¶é—´æˆ³æ ¼å¼ï¼šæ ‡å‡†åŒ–æ—¶é—´è®°å½•ï¼Œæ”¯æŒæ¯«ç§’ç²¾åº¦
ğŸ”¸ æ—¥å¿—è½®è½¬æœºåˆ¶ï¼šè‡ªåŠ¨ç®¡ç†æ—¥å¿—æ–‡ä»¶å¤§å°å’Œæ•°é‡
ğŸ”¸ syslogé›†æˆï¼šç³»ç»Ÿçº§æ—¥å¿—ç»Ÿä¸€ç®¡ç†å’Œè¿œç¨‹ä¼ è¾“
ğŸ”¸ ç»“æ„åŒ–è¾“å‡ºï¼šJSONæ ¼å¼ä¾¿äºè‡ªåŠ¨åŒ–åˆ†æ
ğŸ”¸ æ•æ„Ÿä¿¡æ¯è„±æ•ï¼šä¿æŠ¤éšç§å’Œå•†ä¸šæœºå¯†
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è§„èŒƒçš„æ—¥å¿—ç®¡ç†**
```
é—®é¢˜è¿½è¸ªï¼š
- ç¨‹åºå‡ºé”™æ—¶èƒ½å¿«é€Ÿå®šä½é—®é¢˜åŸå› 
- æä¾›è¯¦ç»†çš„æ‰§è¡Œè½¨è¿¹å’Œä¸Šä¸‹æ–‡ä¿¡æ¯

æ€§èƒ½ç›‘æ§ï¼š
- å®æ—¶ç›‘æ§ç³»ç»Ÿå’Œåº”ç”¨æ€§èƒ½æŒ‡æ ‡  
- ä¸ºå®¹é‡è§„åˆ’æä¾›æ•°æ®æ”¯æŒ

å®‰å…¨å®¡è®¡ï¼š
- è®°å½•ç”¨æˆ·æ“ä½œå’Œç³»ç»Ÿäº‹ä»¶
- æ»¡è¶³åˆè§„è¦æ±‚å’Œå®‰å…¨åˆ†æéœ€æ±‚

è¿ç»´è‡ªåŠ¨åŒ–ï¼š
- æ”¯æŒè‡ªåŠ¨åŒ–ç›‘æ§å‘Šè­¦
- ä¸DevOpså·¥å…·é“¾é›†æˆ
```

**ğŸ”¹ æ—¥å¿—çº§åˆ«çš„å®é™…åº”ç”¨ç­–ç•¥**
```
ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š
INFOçº§åˆ«  â†’ è®°å½•å…³é”®ä¸šåŠ¡æ“ä½œ
WARNçº§åˆ«  â†’ è®°å½•æ½œåœ¨é—®é¢˜å’Œæ€§èƒ½è­¦å‘Š  
ERRORçº§åˆ« â†’ è®°å½•é”™è¯¯ä½†ç¨‹åºå¯ç»§ç»­è¿è¡Œ
FATALçº§åˆ« â†’ è®°å½•è‡´å‘½é”™è¯¯ï¼Œç¨‹åºåœæ­¢

å¼€å‘ç¯å¢ƒå¯ä»¥ï¼š
DEBUGçº§åˆ« â†’ è¯¦ç»†çš„ç¨‹åºæ‰§è¡Œæµç¨‹
TRACEçº§åˆ« â†’ æœ€è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®éœ€è¦ä¸´æ—¶è°ƒæ•´æ—¥å¿—çº§åˆ«
```

**ğŸ”¹ ç»“æ„åŒ–vséç»“æ„åŒ–æ—¥å¿—é€‰æ‹©**
```
ç»“æ„åŒ–æ—¥å¿—é€‚ç”¨ï¼š
âœ… éœ€è¦è‡ªåŠ¨åŒ–åˆ†æå’Œå¤„ç†
âœ… ä¸æ—¥å¿—åˆ†æå·¥å…·é›†æˆ  
âœ… å¤æ‚çš„æŸ¥è¯¢å’Œç»Ÿè®¡éœ€æ±‚
âœ… å¾®æœåŠ¡æ¶æ„çš„ç»Ÿä¸€æ—¥å¿—

ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—é€‚ç”¨ï¼š  
âœ… ç®€å•è„šæœ¬å’Œå°å‹åº”ç”¨
âœ… äººå·¥æŸ¥çœ‹ä¸ºä¸»çš„åœºæ™¯
âœ… èµ„æºå—é™çš„ç¯å¢ƒ
âœ… å¿«é€Ÿå¼€å‘å’Œè°ƒè¯•
```

### 10.3 å®é™…åº”ç”¨æœ€ä½³å®è·µ


**ğŸ“Š æ—¥å¿—ç®¡ç†ç­–ç•¥å»ºè®®**
```
æ–‡ä»¶ç»„ç»‡ï¼š
/var/log/åº”ç”¨å/
â”œâ”€â”€ app.log              â† å½“å‰æ—¥å¿—
â”œâ”€â”€ app.log.1.gz         â† æ˜¨å¤©æ—¥å¿—
â”œâ”€â”€ error.log            â† é”™è¯¯ä¸“ç”¨æ—¥å¿—  
â”œâ”€â”€ performance.log      â† æ€§èƒ½ç›‘æ§æ—¥å¿—
â””â”€â”€ audit.log           â† å®¡è®¡æ—¥å¿—

è½®è½¬é…ç½®ï¼š
â€¢ å¤§å°é™åˆ¶ï¼šå•æ–‡ä»¶ä¸è¶…è¿‡100MB
â€¢ ä¿ç•™æ—¶é—´ï¼šä¿ç•™30å¤©çš„æ—¥å¿—æ–‡ä»¶
â€¢ å‹ç¼©å­˜å‚¨ï¼š3å¤©å‰çš„æ—¥å¿—è‡ªåŠ¨å‹ç¼©
â€¢ è‡ªåŠ¨æ¸…ç†ï¼šè¶…è¿‡ä¿ç•™æœŸçš„æ—¥å¿—è‡ªåŠ¨åˆ é™¤
```

**âš¡ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
é¿å…é¢‘ç¹ç£ç›˜å†™å…¥ï¼š
â€¢ ä½¿ç”¨ç¼“å†²åŒºæ‰¹é‡å†™å…¥
â€¢ å¼‚æ­¥æ—¥å¿—å†™å…¥ï¼ˆåå°è¿›ç¨‹ï¼‰
â€¢ åˆç†è®¾ç½®åˆ·æ–°é—´éš”

å‡å°‘æ—¥å¿—å¤„ç†å¼€é”€ï¼š
â€¢ é¿å…åœ¨é«˜é¢‘å‡½æ•°ä¸­è®°å½•DEBUGæ—¥å¿—
â€¢ ä½¿ç”¨æ¡ä»¶åˆ¤æ–­æ§åˆ¶æ—¥å¿—è¾“å‡º
â€¢ é¢„å…ˆæ ¼å¼åŒ–å¸¸ç”¨çš„æ—¥å¿—æ¨¡æ¿

å­˜å‚¨ç©ºé—´ä¼˜åŒ–ï¼š
â€¢ åŠæ—¶æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶  
â€¢ å‹ç¼©éæ´»è·ƒæ—¥å¿—
â€¢ ä½¿ç”¨æ—¥å¿—é‡‡æ ·å‡å°‘æ•°æ®é‡
```

**ğŸ”’ å®‰å…¨è€ƒè™‘è¦ç‚¹**
```
æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ï¼š
â€¢ å»ºç«‹æ•æ„Ÿä¿¡æ¯è¯†åˆ«æœºåˆ¶
â€¢ å®æ–½è‡ªåŠ¨è„±æ•å¤„ç†
â€¢ å®šæœŸå®¡æŸ¥æ—¥å¿—å†…å®¹

è®¿é—®æ§åˆ¶ï¼š
â€¢ è®¾ç½®åˆé€‚çš„æ–‡ä»¶æƒé™
â€¢ å®æ–½åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
â€¢ è®°å½•æ—¥å¿—è®¿é—®å®¡è®¡

ä¼ è¾“å®‰å…¨ï¼š
â€¢ ä½¿ç”¨åŠ å¯†ä¼ è¾“åè®®
â€¢ éªŒè¯è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨èº«ä»½
â€¢ å®æ–½æ—¥å¿—å®Œæ•´æ€§æ ¡éªŒ
```

### 10.4 å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ


| é—®é¢˜åœºæ™¯ | **ç—‡çŠ¶è¡¨ç°** | **è§£å†³æ–¹æ¡ˆ** | **é¢„é˜²æªæ–½** |
|---------|------------|-------------|-------------|
| ğŸš¨ **æ—¥å¿—æ–‡ä»¶è¿‡å¤§** | `ç£ç›˜ç©ºé—´ä¸è¶³ï¼ŒæŸ¥è¯¢ç¼“æ…¢` | `å®æ–½æ—¥å¿—è½®è½¬ï¼Œæ¸…ç†æ—§æ–‡ä»¶` | `è®¾ç½®å¤§å°é™åˆ¶ï¼Œå®šæœŸç›‘æ§` |
| ğŸ“Š **æ—¥å¿—ä¸¢å¤±** | `å…³é”®äº‹ä»¶æ²¡æœ‰è®°å½•` | `æ£€æŸ¥æƒé™ï¼Œä¿®å¤è½®è½¬é…ç½®` | `ç›‘æ§æ—¥å¿—å†™å…¥ï¼Œè®¾ç½®å‘Šè­¦` |
| ğŸ” **æŸ¥è¯¢æ•ˆç‡ä½** | `æœç´¢æ—¥å¿—è€—æ—¶è¿‡é•¿` | `å»ºç«‹ç´¢å¼•ï¼Œä¼˜åŒ–æœç´¢ç­–ç•¥` | `åˆç†åˆ†ç±»ï¼Œç»“æ„åŒ–å­˜å‚¨` |
| ğŸ” **æ•æ„Ÿä¿¡æ¯æ³„éœ²** | `æ—¥å¿—åŒ…å«æ˜æ–‡å¯†ç ç­‰` | `å®æ–½è„±æ•å¤„ç†ï¼ŒåŠ å¼ºè®¿é—®æ§åˆ¶` | `å»ºç«‹è„±æ•è§„èŒƒï¼Œå®šæœŸå®¡æŸ¥` |

### 10.5 å‘å±•è¶‹åŠ¿å’Œæ‰©å±•


```
ç°ä»£æ—¥å¿—ç®¡ç†è¶‹åŠ¿ï¼š
ğŸ”¸ å®¹å™¨åŒ–ç¯å¢ƒï¼šDockerã€Kubernetesæ—¥å¿—ç®¡ç†
ğŸ”¸ å¾®æœåŠ¡æ¶æ„ï¼šåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªå’Œå…³è”
ğŸ”¸ å®æ—¶åˆ†æï¼šELK Stackã€Grafanaç­‰å·¥å…·é›†æˆ
ğŸ”¸ AIè¾…åŠ©ï¼šæ™ºèƒ½å¼‚å¸¸æ£€æµ‹å’Œæ ¹å› åˆ†æ
ğŸ”¸ äº‘åŸç”Ÿï¼šäº‘æœåŠ¡å•†çš„æ‰˜ç®¡æ—¥å¿—æœåŠ¡

Shellè„šæœ¬çš„è§’è‰²ï¼š
â€¢ æ•°æ®é¢„å¤„ç†å’Œæ¸…æ´—
â€¢ ç®€å•çš„æ—¥å¿—åˆ†æå’Œç»Ÿè®¡  
â€¢ ä¸å…¶ä»–å·¥å…·çš„èƒ¶æ°´å±‚
â€¢ è½»é‡çº§ç›‘æ§å’Œå‘Šè­¦
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ—¥å¿—è®°å½•è¦è§„èŒƒï¼Œçº§åˆ«æ—¶é—´æ ¼å¼å…¨
- è½®è½¬è„±æ•ä¿å®‰å…¨ï¼Œç»“æ„ä¼˜åŒ–æ€§èƒ½å…ˆ  
- syslogé›†æˆè¿œç¨‹ä¼ ï¼ŒJSONç»“æ„æ˜“åˆ†æ
- ç›‘æ§å‘Šè­¦è¦åŠæ—¶ï¼Œé—®é¢˜æ’æŸ¥æœ‰ä¾æ®