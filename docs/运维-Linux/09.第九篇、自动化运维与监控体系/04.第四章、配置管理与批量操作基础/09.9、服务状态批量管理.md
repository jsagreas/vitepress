---
title: 9ã€æœåŠ¡çŠ¶æ€æ‰¹é‡ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [æ‰¹é‡æœåŠ¡æ§åˆ¶åŸºç¡€](#1-æ‰¹é‡æœåŠ¡æ§åˆ¶åŸºç¡€)
2. [æœåŠ¡çŠ¶æ€æ‰¹é‡æŸ¥è¯¢](#2-æœåŠ¡çŠ¶æ€æ‰¹é‡æŸ¥è¯¢)
3. [å¼€æœºè‡ªå¯åŠ¨æ‰¹é‡è®¾ç½®](#3-å¼€æœºè‡ªå¯åŠ¨æ‰¹é‡è®¾ç½®)
4. [æœåŠ¡é…ç½®ç»Ÿä¸€ç®¡ç†](#4-æœåŠ¡é…ç½®ç»Ÿä¸€ç®¡ç†)
5. [æœåŠ¡ä¾èµ–å…³ç³»å¤„ç†](#5-æœåŠ¡ä¾èµ–å…³ç³»å¤„ç†)
6. [æœåŠ¡æ—¥å¿—é›†ä¸­æ”¶é›†](#6-æœåŠ¡æ—¥å¿—é›†ä¸­æ”¶é›†)
7. [æœåŠ¡å¥åº·æ£€æŸ¥](#7-æœåŠ¡å¥åº·æ£€æŸ¥)
8. [æœåŠ¡æ•…éšœè‡ªåŠ¨æ¢å¤](#8-æœåŠ¡æ•…éšœè‡ªåŠ¨æ¢å¤)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›ï¸ æ‰¹é‡æœåŠ¡æ§åˆ¶åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯æ‰¹é‡æœåŠ¡ç®¡ç†


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
æ‰¹é‡æœåŠ¡ç®¡ç†å°±æ˜¯**ä¸€æ¬¡æ“ä½œå¤šä¸ªæœåŠ¡**ï¼Œå°±åƒåŒæ—¶å¼€å…³å¤šä¸ªç”µå™¨ä¸€æ ·ã€‚æƒ³è±¡ä½ è¦åŒæ—¶å¯åŠ¨WebæœåŠ¡å™¨ã€æ•°æ®åº“ã€ç¼“å­˜ç­‰å¤šä¸ªæœåŠ¡ï¼Œä¸€ä¸ªä¸ªæ‰‹åŠ¨æ“ä½œå¤ªéº»çƒ¦ï¼Œæ‰¹é‡æ“ä½œå°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ‰¹é‡ç®¡ç†**
```
å•ä¸ªæœåŠ¡æ“ä½œï¼š
systemctl start nginx    â† åªèƒ½å¯åŠ¨ä¸€ä¸ª
systemctl start mysql    â† åˆè¦æ•²ä¸€éå‘½ä»¤
systemctl start redis    â† è¿˜è¦æ•²ä¸€é...

æ‰¹é‡æ“ä½œçš„ä¼˜åŠ¿ï¼š
â€¢ æ•ˆç‡é«˜ï¼šä¸€æ¡å‘½ä»¤å¤„ç†å¤šä¸ªæœåŠ¡
â€¢ å‡å°‘é”™è¯¯ï¼šé¿å…é‡å¤æ“ä½œçš„å¤±è¯¯
â€¢ ç»Ÿä¸€ç®¡ç†ï¼šä¿è¯æœåŠ¡çŠ¶æ€ä¸€è‡´æ€§
â€¢ è‡ªåŠ¨åŒ–ï¼šå¯ä»¥å†™æˆè„šæœ¬è‡ªåŠ¨æ‰§è¡Œ
```

### 1.2 systemctlæ‰¹é‡æ“ä½œè¯­æ³•


**ğŸ”§ åŸºæœ¬æ‰¹é‡è¯­æ³•**
```bash
# æ‰¹é‡å¯åŠ¨å¤šä¸ªæœåŠ¡
systemctl start æœåŠ¡1 æœåŠ¡2 æœåŠ¡3

# æ‰¹é‡åœæ­¢å¤šä¸ªæœåŠ¡  
systemctl stop æœåŠ¡1 æœåŠ¡2 æœåŠ¡3

# æ‰¹é‡é‡å¯å¤šä¸ªæœåŠ¡
systemctl restart æœåŠ¡1 æœåŠ¡2 æœåŠ¡3
```

**â­ å®é™…ä¾‹å­**
```bash
# æ‰¹é‡å¯åŠ¨Webç›¸å…³æœåŠ¡
systemctl start nginx mysql php-fpm redis

# æ‰¹é‡åœæ­¢è¿™äº›æœåŠ¡
systemctl stop nginx mysql php-fpm redis

# æ‰¹é‡é‡å¯æ•°æ®åº“ç›¸å…³æœåŠ¡
systemctl restart mysql redis postgresql
```

### 1.3 ä½¿ç”¨é€šé…ç¬¦æ‰¹é‡æ“ä½œ


**ğŸ¯ é€šé…ç¬¦æ¨¡å¼**
Linuxæ”¯æŒç”¨é€šé…ç¬¦æ¥åŒ¹é…å¤šä¸ªæœåŠ¡åï¼Œå°±åƒç”¨`*.txt`åŒ¹é…æ‰€æœ‰æ–‡æœ¬æ–‡ä»¶ä¸€æ ·ã€‚

```bash
# åœæ­¢æ‰€æœ‰ä»¥httpå¼€å¤´çš„æœåŠ¡
systemctl stop http*

# é‡å¯æ‰€æœ‰åŒ…å«sqlçš„æœåŠ¡  
systemctl restart *sql*

# å¯åŠ¨æ‰€æœ‰ä»¥phpå¼€å¤´çš„æœåŠ¡
systemctl start php*
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šé€šé…ç¬¦æ“ä½œè¦å°å¿ƒï¼Œå»ºè®®å…ˆç”¨`list-units`æŸ¥çœ‹ä¼šåŒ¹é…åˆ°å“ªäº›æœåŠ¡ï¼Œé¿å…è¯¯æ“ä½œã€‚

**ğŸ“Š æ‰¹é‡æ“ä½œç»“æœæ£€æŸ¥**
```bash
# æ£€æŸ¥æ‰¹é‡æ“ä½œæ˜¯å¦æˆåŠŸ
systemctl is-active nginx mysql redis
# è¾“å‡ºï¼š
# active
# active  
# active

# æ‰¹é‡æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²å¯ç”¨
systemctl is-enabled nginx mysql redis
```

---

## 2. ğŸ” æœåŠ¡çŠ¶æ€æ‰¹é‡æŸ¥è¯¢


### 2.1 æ‰¹é‡æŸ¥çœ‹æœåŠ¡çŠ¶æ€


**ğŸ”¸ ä»€ä¹ˆæ˜¯æœåŠ¡çŠ¶æ€**
æœåŠ¡çŠ¶æ€å°±æ˜¯å‘Šè¯‰ä½ è¿™ä¸ªæœåŠ¡ç°åœ¨æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œå°±åƒæŸ¥çœ‹ç”µå™¨æ˜¯å¼€ç€è¿˜æ˜¯å…³ç€ã€‚LinuxæœåŠ¡ä¸»è¦æœ‰è¿™å‡ ç§çŠ¶æ€ï¼š
- `active (running)`ï¼šæ­£åœ¨è¿è¡Œä¸­
- `inactive (dead)`ï¼šå·²åœæ­¢
- `failed`ï¼šå¯åŠ¨å¤±è´¥
- `enabled`ï¼šå¼€æœºä¼šè‡ªåŠ¨å¯åŠ¨
- `disabled`ï¼šå¼€æœºä¸ä¼šè‡ªåŠ¨å¯åŠ¨

**ğŸ“‹ æ‰¹é‡çŠ¶æ€æŸ¥è¯¢å‘½ä»¤**
```bash
# æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„è¯¦ç»†çŠ¶æ€
systemctl status nginx mysql redis

# åªçœ‹æœåŠ¡æ˜¯å¦è¿è¡Œï¼ˆç®€æ´è¾“å‡ºï¼‰
systemctl is-active nginx mysql redis

# åªçœ‹æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼ˆç®€æ´è¾“å‡ºï¼‰
systemctl is-enabled nginx mysql redis
```

### 2.2 æ ¼å¼åŒ–çŠ¶æ€è¾“å‡º


**ğŸ¨ è‡ªå®šä¹‰çŠ¶æ€æ˜¾ç¤ºæ ¼å¼**
æœ‰æ—¶å€™é»˜è®¤è¾“å‡ºä¿¡æ¯å¤ªå¤šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›æŠ€å·§è®©è¾“å‡ºæ›´æ¸…æ™°ï¼š

```bash
# åˆ›å»ºä¸€ä¸ªæŸ¥çœ‹æœåŠ¡çŠ¶æ€çš„å‡½æ•°
check_services() {
    for service in "$@"; do
        status=$(systemctl is-active $service 2>/dev/null)
        enabled=$(systemctl is-enabled $service 2>/dev/null)
        printf "%-15s | %-10s | %-10s\n" "$service" "$status" "$enabled"
    done
}

# ä½¿ç”¨æ–¹æ³•
check_services nginx mysql redis php-fpm
```

**ğŸ“Š è¾“å‡ºç»“æœç¤ºä¾‹**
```
æœåŠ¡å          | è¿è¡ŒçŠ¶æ€    | å¯åŠ¨çŠ¶æ€
nginx          | active    | enabled
mysql          | active    | enabled  
redis          | inactive  | disabled
php-fpm        | failed    | enabled
```

### 2.3 æŒ‰æ¨¡å¼æŸ¥è¯¢æœåŠ¡


**ğŸ” æŸ¥è¯¢ç‰¹å®šæ¨¡å¼çš„æœåŠ¡**
```bash
# æŸ¥çœ‹æ‰€æœ‰Webç›¸å…³æœåŠ¡çŠ¶æ€
systemctl list-units --type=service | grep -E "(nginx|apache|http)"

# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ç›¸å…³æœåŠ¡
systemctl list-units --type=service | grep -E "(mysql|postgres|mongo|redis)"

# æŸ¥çœ‹æ‰€æœ‰å¤±è´¥çš„æœåŠ¡
systemctl list-units --type=service --state=failed

# æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„æœåŠ¡
systemctl list-units --type=service --state=active
```

**ğŸ’¡ å®ç”¨æŸ¥è¯¢æŠ€å·§**
| å‘½ä»¤ç›®çš„ | å‘½ä»¤ç¤ºä¾‹ | è¯´æ˜ |
|---------|----------|------|
| ğŸ” **æŸ¥çœ‹å¤±è´¥æœåŠ¡** | `systemctl --failed` | å¿«é€Ÿæ‰¾åˆ°æœ‰é—®é¢˜çš„æœåŠ¡ |
| ğŸ“ˆ **æŸ¥çœ‹è¿è¡ŒæœåŠ¡** | `systemctl list-units --type=service --state=running` | çœ‹å“ªäº›æœåŠ¡åœ¨è¿è¡Œ |
| ğŸš€ **æŸ¥çœ‹å¯åŠ¨æœåŠ¡** | `systemctl list-unit-files --type=service --state=enabled` | çœ‹å“ªäº›ä¼šå¼€æœºå¯åŠ¨ |

---

## 3. âš™ï¸ å¼€æœºè‡ªå¯åŠ¨æ‰¹é‡è®¾ç½®


### 3.1 ç†è§£å¼€æœºè‡ªå¯åŠ¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¼€æœºè‡ªå¯åŠ¨**
å¼€æœºè‡ªå¯åŠ¨å°±æ˜¯è®©æœåŠ¡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼Œå°±åƒä½ çš„æ‰‹æœºå¼€æœºåè‡ªåŠ¨æ‰“å¼€å¾®ä¿¡ä¸€æ ·ã€‚è¿™æ ·æœåŠ¡å™¨é‡å¯åï¼Œé‡è¦æœåŠ¡ä¼šè‡ªåŠ¨æ¢å¤è¿è¡Œã€‚

**ğŸ’­ è‡ªå¯åŠ¨çš„é‡è¦æ€§**
```
åœºæ™¯ä¸¾ä¾‹ï¼š
ä½ çš„WebæœåŠ¡å™¨çªç„¶åœç”µé‡å¯äº†
å¦‚æœæ²¡è®¾ç½®è‡ªå¯åŠ¨ï¼šç½‘ç«™æ‰“ä¸å¼€ï¼Œç”¨æˆ·è®¿é—®å¤±è´¥
å¦‚æœè®¾ç½®äº†è‡ªå¯åŠ¨ï¼šç³»ç»Ÿå¯åŠ¨åWebæœåŠ¡è‡ªåŠ¨è¿è¡Œï¼Œç½‘ç«™æ­£å¸¸

æ ¸å¿ƒä½œç”¨ï¼š
â€¢ æé«˜å¯ç”¨æ€§ï¼šå‡å°‘äººå·¥å¹²é¢„æ—¶é—´
â€¢ é™ä½æ•…éšœå½±å“ï¼šç³»ç»Ÿé‡å¯åæœåŠ¡è‡ªåŠ¨æ¢å¤  
â€¢ è¿ç»´ä¾¿åˆ©ï¼šä¸ç”¨åŠå¤œèµ·æ¥æ‰‹åŠ¨å¯åŠ¨æœåŠ¡
```

### 3.2 æ‰¹é‡è®¾ç½®è‡ªå¯åŠ¨


**ğŸ¯ æ‰¹é‡å¯ç”¨è‡ªå¯åŠ¨**
```bash
# æ‰¹é‡è®¾ç½®å¤šä¸ªæœåŠ¡å¼€æœºè‡ªå¯åŠ¨
systemctl enable nginx mysql redis php-fpm

# åŒæ—¶å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®è‡ªå¯åŠ¨
systemctl enable --now nginx mysql redis

# æ‰¹é‡ç¦ç”¨è‡ªå¯åŠ¨
systemctl disable nginx mysql redis php-fpm
```

**ğŸ“‹ æ£€æŸ¥è‡ªå¯åŠ¨è®¾ç½®**
```bash
# æ‰¹é‡æ£€æŸ¥è‡ªå¯åŠ¨çŠ¶æ€
systemctl is-enabled nginx mysql redis

# æŸ¥çœ‹æ‰€æœ‰å·²å¯ç”¨è‡ªå¯åŠ¨çš„æœåŠ¡
systemctl list-unit-files --type=service --state=enabled | grep -v "@"
```

### 3.3 æŒ‰æœåŠ¡ç±»å‹æ‰¹é‡è®¾ç½®


**ğŸ·ï¸ WebæœåŠ¡å…¨å¥—è‡ªå¯åŠ¨**
```bash
# WebæœåŠ¡å™¨ç›¸å…³æœåŠ¡
WEB_SERVICES="nginx php-fpm mysql redis"
systemctl enable $WEB_SERVICES

# æ•°æ®åº“ç›¸å…³æœåŠ¡  
DB_SERVICES="mysql postgresql redis mongodb"
systemctl enable $DB_SERVICES

# ç›‘æ§ç›¸å…³æœåŠ¡
MONITOR_SERVICES="prometheus node_exporter grafana"
systemctl enable $MONITOR_SERVICES
```

**âš¡ ä¸€é”®å¼ç¯å¢ƒå¯åŠ¨è„šæœ¬**
```bash
#!/bin/bash
# ä¿å­˜ä¸º start-web-env.sh

echo "æ­£åœ¨å¯åŠ¨Webç¯å¢ƒç›¸å…³æœåŠ¡..."

# å®šä¹‰æœåŠ¡åˆ—è¡¨
SERVICES=("nginx" "mysql" "php-fpm" "redis")

# æ‰¹é‡å¯åŠ¨å¹¶è®¾ç½®è‡ªå¯åŠ¨
for service in "${SERVICES[@]}"; do
    echo "å¯åŠ¨ $service..."
    systemctl enable --now $service
    
    # æ£€æŸ¥å¯åŠ¨æ˜¯å¦æˆåŠŸ
    if systemctl is-active --quiet $service; then
        echo "âœ… $service å¯åŠ¨æˆåŠŸ"
    else
        echo "âŒ $service å¯åŠ¨å¤±è´¥"
    fi
done

echo "Webç¯å¢ƒå¯åŠ¨å®Œæˆï¼"
```

---

## 4. ğŸ“ æœåŠ¡é…ç½®ç»Ÿä¸€ç®¡ç†


### 4.1 ç†è§£æœåŠ¡é…ç½®ç®¡ç†


**ğŸ”¸ ä»€ä¹ˆæ˜¯é…ç½®ç»Ÿä¸€ç®¡ç†**
é…ç½®ç»Ÿä¸€ç®¡ç†å°±æ˜¯æŠŠå¤šä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ç»Ÿä¸€ç®¡ç†ï¼Œå°±åƒæŠŠæ‰€æœ‰é‡è¦æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œä¸€æ ·ã€‚è¿™æ ·ä¾¿äºå¤‡ä»½ã€ä¿®æ”¹å’Œç‰ˆæœ¬æ§åˆ¶ã€‚

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€ç®¡ç†é…ç½®**
```
åˆ†æ•£é…ç½®çš„é—®é¢˜ï¼š
/etc/nginx/nginx.conf        â† nginxé…ç½®
/etc/mysql/my.cnf           â† mysqlé…ç½®  
/etc/redis/redis.conf       â† redisé…ç½®
/etc/php/7.4/fpm/php.ini    â† phpé…ç½®

ç»Ÿä¸€ç®¡ç†çš„å¥½å¤„ï¼š
â€¢ ä¾¿äºå¤‡ä»½ï¼šä¸€æ¬¡æ€§å¤‡ä»½æ‰€æœ‰é…ç½®
â€¢ ç‰ˆæœ¬æ§åˆ¶ï¼šå¯ä»¥ç”¨gitç®¡ç†é…ç½®å˜æ›´
â€¢ æ‰¹é‡ä¿®æ”¹ï¼šç»Ÿä¸€çš„é…ç½®æ¨¡æ¿å’Œå˜é‡
â€¢ ç¯å¢ƒåŒæ­¥ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®ä¸€è‡´
```

### 4.2 åˆ›å»ºé…ç½®ç®¡ç†ç›®å½•ç»“æ„


**ğŸ“‚ æ¨èçš„ç›®å½•ç»“æ„**
```
/opt/configs/
â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â””â”€â”€ sites-available/
â”œâ”€â”€ mysql/  
â”‚   â””â”€â”€ my.cnf
â”œâ”€â”€ redis/
â”‚   â””â”€â”€ redis.conf
â”œâ”€â”€ php/
â”‚   â””â”€â”€ php-fpm.conf
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy-configs.sh
â”‚   â””â”€â”€ backup-configs.sh
â””â”€â”€ templates/
    â”œâ”€â”€ nginx.conf.template
    â””â”€â”€ mysql.conf.template
```

**ğŸ”§ é…ç½®éƒ¨ç½²è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# ç»Ÿä¸€éƒ¨ç½²é…ç½®æ–‡ä»¶è„šæœ¬

CONFIG_DIR="/opt/configs"
BACKUP_DIR="/opt/config-backups/$(date +%Y%m%d_%H%M%S)"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½åŸé…ç½®å¹¶éƒ¨ç½²æ–°é…ç½®
deploy_config() {
    local service=$1
    local config_file=$2
    local target_path=$3
    
    echo "æ­£åœ¨éƒ¨ç½² $service é…ç½®..."
    
    # å¤‡ä»½åŸé…ç½®
    if [ -f "$target_path" ]; then
        cp "$target_path" "$BACKUP_DIR/${service}.conf.bak"
    fi
    
    # éƒ¨ç½²æ–°é…ç½®
    cp "$CONFIG_DIR/$service/$config_file" "$target_path"
    
    # éªŒè¯é…ç½®å¹¶é‡è½½æœåŠ¡
    systemctl reload $service
    if [ $? -eq 0 ]; then
        echo "âœ… $service é…ç½®éƒ¨ç½²æˆåŠŸ"
    else
        echo "âŒ $service é…ç½®éƒ¨ç½²å¤±è´¥ï¼Œæ­£åœ¨å›æ»š..."
        cp "$BACKUP_DIR/${service}.conf.bak" "$target_path" 2>/dev/null
        systemctl reload $service
    fi
}

# æ‰¹é‡éƒ¨ç½²é…ç½®
deploy_config "nginx" "nginx.conf" "/etc/nginx/nginx.conf"
deploy_config "mysql" "my.cnf" "/etc/mysql/my.cnf"  
deploy_config "redis" "redis.conf" "/etc/redis/redis.conf"
```

### 4.3 é…ç½®æ¨¡æ¿åŒ–ç®¡ç†


**ğŸ“ ä½¿ç”¨é…ç½®æ¨¡æ¿**
é…ç½®æ¨¡æ¿å°±æ˜¯æŠŠé…ç½®æ–‡ä»¶ä¸­ç»å¸¸å˜åŒ–çš„éƒ¨åˆ†ç”¨å˜é‡ä»£æ›¿ï¼Œå°±åƒå¡«ç©ºé¢˜ä¸€æ ·ã€‚

```bash
# nginxé…ç½®æ¨¡æ¿ (nginx.conf.template)
worker_processes {{WORKER_PROCESSES}};
server_name {{SERVER_NAME}};
listen {{HTTP_PORT}};

# MySQLé…ç½®æ¨¡æ¿ (mysql.conf.template)  
port = {{MYSQL_PORT}}
max_connections = {{MAX_CONNECTIONS}}
innodb_buffer_pool_size = {{BUFFER_POOL_SIZE}}
```

**ğŸ› ï¸ æ¨¡æ¿å˜é‡æ›¿æ¢è„šæœ¬**
```bash
#!/bin/bash
# æ ¹æ®ç¯å¢ƒå˜é‡ç”Ÿæˆé…ç½®æ–‡ä»¶

generate_config() {
    local template=$1
    local output=$2
    
    # æ›¿æ¢æ¨¡æ¿ä¸­çš„å˜é‡
    envsubst < $template > $output
    echo "é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ: $output"
}

# è®¾ç½®ç¯å¢ƒå˜é‡
export SERVER_NAME="example.com"
export HTTP_PORT="80"
export MYSQL_PORT="3306"
export MAX_CONNECTIONS="200"

# ç”Ÿæˆé…ç½®æ–‡ä»¶
generate_config "templates/nginx.conf.template" "nginx/nginx.conf"
generate_config "templates/mysql.conf.template" "mysql/my.cnf"
```

---

## 5. ğŸ”— æœåŠ¡ä¾èµ–å…³ç³»å¤„ç†


### 5.1 ç†è§£æœåŠ¡ä¾èµ–


**ğŸ”¸ ä»€ä¹ˆæ˜¯æœåŠ¡ä¾èµ–**
æœåŠ¡ä¾èµ–å°±æ˜¯ä¸€ä¸ªæœåŠ¡éœ€è¦å¦ä¸€ä¸ªæœåŠ¡å…ˆå¯åŠ¨æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œå°±åƒä½ è¦å…ˆæ‰“å¼€ç”µè„‘æ‰èƒ½ä¸Šç½‘ä¸€æ ·ã€‚

**ğŸ’­ å¸¸è§çš„ä¾èµ–å…³ç³»**
```
å…¸å‹Webåº”ç”¨ä¾èµ–é“¾ï¼š
ç½‘ç»œæœåŠ¡ â†’ æ•°æ®åº“ â†’ åº”ç”¨æœåŠ¡ â†’ WebæœåŠ¡å™¨

å…·ä½“ä¾‹å­ï¼š
network.target â†’ mysql â†’ php-fpm â†’ nginx

ä¾èµ–é—®é¢˜ï¼š
å¦‚æœmysqlæ²¡å¯åŠ¨ï¼Œphp-fpmå°±è¿ä¸ä¸Šæ•°æ®åº“
å¦‚æœphp-fpmæ²¡å¯åŠ¨ï¼Œnginxå°±å¤„ç†ä¸äº†PHPè¯·æ±‚
```

### 5.2 æŸ¥çœ‹å’Œåˆ†æä¾èµ–å…³ç³»


**ğŸ” æŸ¥çœ‹æœåŠ¡ä¾èµ–**
```bash
# æŸ¥çœ‹æœåŠ¡çš„ä¾èµ–å…³ç³»
systemctl list-dependencies nginx

# æŸ¥çœ‹æœåŠ¡è¢«å“ªäº›æœåŠ¡ä¾èµ–
systemctl list-dependencies --reverse nginx

# æŸ¥çœ‹è¯¦ç»†çš„ä¾èµ–æ ‘
systemctl list-dependencies --all nginx
```

**ğŸ“Š ä¾èµ–å…³ç³»åˆ†æè¾“å‡ºç¤ºä¾‹**
```
nginx.service
â”œâ”€system.slice
â”œâ”€network.target
â”‚ â”œâ”€NetworkManager.service
â”‚ â”œâ”€network-online.target
â”‚ â””â”€systemd-resolved.service
â””â”€sysinit.target
  â”œâ”€local-fs.target
  â””â”€swap.target
```

### 5.3 æ­£ç¡®çš„å¯åŠ¨é¡ºåºç®¡ç†


**âš¡ æŒ‰ä¾èµ–é¡ºåºæ‰¹é‡å¯åŠ¨**
```bash
#!/bin/bash
# æŒ‰æ­£ç¡®é¡ºåºå¯åŠ¨Webç¯å¢ƒ

echo "æŒ‰ä¾èµ–é¡ºåºå¯åŠ¨æœåŠ¡..."

# ç¬¬ä¸€å±‚ï¼šåŸºç¡€æœåŠ¡
echo "å¯åŠ¨åŸºç¡€æœåŠ¡..."
systemctl start network-online.target
sleep 2

# ç¬¬äºŒå±‚ï¼šæ•°æ®åº“æœåŠ¡
echo "å¯åŠ¨æ•°æ®åº“æœåŠ¡..." 
systemctl start mysql redis
sleep 3

# ç¬¬ä¸‰å±‚ï¼šåº”ç”¨æœåŠ¡
echo "å¯åŠ¨åº”ç”¨æœåŠ¡..."
systemctl start php-fpm
sleep 2

# ç¬¬å››å±‚ï¼šWebæœåŠ¡å™¨
echo "å¯åŠ¨WebæœåŠ¡å™¨..."
systemctl start nginx

# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
echo "æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
for service in mysql redis php-fpm nginx; do
    if systemctl is-active --quiet $service; then
        echo "âœ… $service è¿è¡Œæ­£å¸¸"
    else
        echo "âŒ $service å¯åŠ¨å¤±è´¥"
    fi
done
```

**â° æ™ºèƒ½ç­‰å¾…ä¾èµ–å°±ç»ª**
```bash
# ç­‰å¾…æœåŠ¡å°±ç»ªçš„å‡½æ•°
wait_for_service() {
    local service=$1
    local timeout=${2:-30}
    local count=0
    
    echo "ç­‰å¾… $service å°±ç»ª..."
    
    while ! systemctl is-active --quiet $service; do
        sleep 1
        count=$((count + 1))
        
        if [ $count -ge $timeout ]; then
            echo "âŒ $service å¯åŠ¨è¶…æ—¶"
            return 1
        fi
    done
    
    echo "âœ… $service å·²å°±ç»ª"
    return 0
}

# ä½¿ç”¨ç¤ºä¾‹
systemctl start mysql
wait_for_service mysql 60

systemctl start php-fpm  
wait_for_service php-fpm 30

systemctl start nginx
wait_for_service nginx 15
```

---

## 6. ğŸ“‹ æœåŠ¡æ—¥å¿—é›†ä¸­æ”¶é›†


### 6.1 ç†è§£æ—¥å¿—é›†ä¸­æ”¶é›†


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ—¥å¿—é›†ä¸­æ”¶é›†**
æ—¥å¿—é›†ä¸­æ”¶é›†å°±æ˜¯æŠŠå¤šä¸ªæœåŠ¡çš„æ—¥å¿—ç»Ÿä¸€æ”¶é›†åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œå°±åƒæŠŠå„ä¸ªéƒ¨é—¨çš„æŠ¥å‘Šé›†ä¸­åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œä¸€æ ·ï¼Œæ–¹ä¾¿ç»Ÿä¸€æŸ¥çœ‹å’Œåˆ†æé—®é¢˜ã€‚

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦é›†ä¸­æ”¶é›†æ—¥å¿—**
```
åˆ†æ•£æ—¥å¿—çš„éº»çƒ¦ï¼š
/var/log/nginx/error.log     â† nginxé”™è¯¯æ—¥å¿—
/var/log/mysql/error.log     â† mysqlé”™è¯¯æ—¥å¿—  
/var/log/php-fpm.log         â† phpé”™è¯¯æ—¥å¿—
journalctl -u redis          â† redisæ—¥å¿—åœ¨systemdé‡Œ

é›†ä¸­æ”¶é›†çš„å¥½å¤„ï¼š
â€¢ ç»Ÿä¸€æŸ¥çœ‹ï¼šä¸€ä¸ªåœ°æ–¹çœ‹åˆ°æ‰€æœ‰æœåŠ¡æ—¥å¿—
â€¢ å…³è”åˆ†æï¼šå®¹æ˜“å‘ç°æœåŠ¡é—´çš„é—®é¢˜å…³è”
â€¢ è‡ªåŠ¨åŒ–å¤„ç†ï¼šå¯ä»¥è‡ªåŠ¨åˆ†æå’ŒæŠ¥è­¦
â€¢ å†å²è¿½è¸ªï¼šä¾¿äºè¿½è¸ªé—®é¢˜çš„æ¥æº
```

### 6.2 ä½¿ç”¨journalctlæ‰¹é‡æŸ¥çœ‹æ—¥å¿—


**ğŸ“– æ‰¹é‡æŸ¥çœ‹æœåŠ¡æ—¥å¿—**
```bash
# åŒæ—¶æŸ¥çœ‹å¤šä¸ªæœåŠ¡çš„æ—¥å¿—
journalctl -u nginx -u mysql -u redis -f

# æŸ¥çœ‹æŒ‡å®šæ—¶é—´æ®µçš„å¤šæœåŠ¡æ—¥å¿—
journalctl -u nginx -u php-fpm --since "1 hour ago"

# æŒ‰ä¼˜å…ˆçº§æŸ¥çœ‹é”™è¯¯æ—¥å¿—
journalctl -p err -u nginx -u mysql --since today
```

**ğŸ¯ å®ç”¨æ—¥å¿—æŸ¥çœ‹ç»„åˆ**
```bash
# æŸ¥çœ‹Webç›¸å…³æœåŠ¡çš„å®æ—¶æ—¥å¿—
web_logs() {
    journalctl -f -u nginx -u php-fpm -u mysql | 
    grep --color=always -E "(ERROR|WARN|error|warning|failed)"
}

# æŸ¥çœ‹æ‰€æœ‰å¤±è´¥æœåŠ¡çš„æ—¥å¿—
failed_logs() {
    systemctl --failed --no-legend | 
    awk '{print $1}' | 
    xargs -I {} journalctl -u {} --since "1 hour ago"
}
```

### 6.3 æ—¥å¿—æ”¶é›†å’Œåˆ†æè„šæœ¬


**ğŸ”§ æ—¥å¿—æ”¶é›†è„šæœ¬**
```bash
#!/bin/bash
# æœåŠ¡æ—¥å¿—æ”¶é›†è„šæœ¬

LOG_DIR="/opt/logs/collected"
DATE=$(date +%Y%m%d_%H%M%S)
SERVICES=("nginx" "mysql" "php-fpm" "redis")

mkdir -p $LOG_DIR

echo "å¼€å§‹æ”¶é›†æœåŠ¡æ—¥å¿—..."

for service in "${SERVICES[@]}"; do
    echo "æ”¶é›† $service æ—¥å¿—..."
    
    # æ”¶é›†æœ€è¿‘1å°æ—¶çš„æ—¥å¿—
    journalctl -u $service --since "1 hour ago" > \
        "$LOG_DIR/${service}_${DATE}.log"
    
    # åªæ”¶é›†é”™è¯¯å’Œè­¦å‘Š
    journalctl -u $service -p warning --since "1 hour ago" > \
        "$LOG_DIR/${service}_errors_${DATE}.log"
done

# ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
echo "ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š..."
{
    echo "=== æœåŠ¡æ—¥å¿—æ±‡æ€»æŠ¥å‘Š ==="
    echo "ç”Ÿæˆæ—¶é—´: $(date)"
    echo ""
    
    for service in "${SERVICES[@]}"; do
        error_count=$(journalctl -u $service -p err --since "1 hour ago" | wc -l)
        warn_count=$(journalctl -u $service -p warning --since "1 hour ago" | wc -l)
        
        echo "$service: é”™è¯¯ $error_count æ¡, è­¦å‘Š $warn_count æ¡"
    done
} > "$LOG_DIR/summary_${DATE}.txt"

echo "âœ… æ—¥å¿—æ”¶é›†å®Œæˆï¼Œæ–‡ä»¶ä¿å­˜åœ¨: $LOG_DIR"
```

**ğŸ“Š æ—¥å¿—åˆ†æå·¥å…·**
```bash
# åˆ†ææ—¥å¿—ä¸­çš„å¸¸è§é”™è¯¯
analyze_errors() {
    local log_dir="/opt/logs/collected"
    
    echo "=== é”™è¯¯ç»Ÿè®¡åˆ†æ ==="
    
    # ç»Ÿè®¡å„ç§é”™è¯¯å‡ºç°æ¬¡æ•°
    find $log_dir -name "*errors*" -exec cat {} \; | \
    grep -E "(404|500|502|503|error|failed|timeout)" | \
    sort | uniq -c | sort -nr | head -10
    
    echo ""
    echo "=== æœ€æ–°é”™è¯¯è¯¦æƒ… ==="
    
    # æ˜¾ç¤ºæœ€è¿‘çš„é”™è¯¯è¯¦æƒ…
    find $log_dir -name "*errors*" -exec tail -5 {} \;
}
```

---

## 7. ğŸ¥ æœåŠ¡å¥åº·æ£€æŸ¥


### 7.1 ä»€ä¹ˆæ˜¯æœåŠ¡å¥åº·æ£€æŸ¥


**ğŸ”¸ å¥åº·æ£€æŸ¥çš„å«ä¹‰**
æœåŠ¡å¥åº·æ£€æŸ¥å°±æ˜¯å®šæœŸæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå°±åƒåŒ»ç”Ÿå®šæœŸä½“æ£€ä¸€æ ·ã€‚ä¸ä»…è¦çœ‹æœåŠ¡æ˜¯å¦åœ¨è¿è¡Œï¼Œè¿˜è¦çœ‹å®ƒèƒ½å¦æ­£å¸¸å“åº”è¯·æ±‚ã€‚

**ğŸ’­ ä¸ºä»€ä¹ˆéœ€è¦å¥åº·æ£€æŸ¥**
```
åªçœ‹è¿›ç¨‹çŠ¶æ€çš„é—®é¢˜ï¼š
systemctl status nginx  # æ˜¾ç¤ºactiveï¼Œä½†å¯èƒ½...
â€¢ nginxè¿›ç¨‹åœ¨è¿è¡Œï¼Œä½†ç«¯å£æ²¡ç›‘å¬
â€¢ ç«¯å£åœ¨ç›‘å¬ï¼Œä½†å“åº”å¾ˆæ…¢
â€¢ èƒ½å“åº”ï¼Œä½†è¿”å›é”™è¯¯é¡µé¢

å…¨é¢å¥åº·æ£€æŸ¥åŒ…æ‹¬ï¼š
â€¢ è¿›ç¨‹çŠ¶æ€ï¼šæœåŠ¡æ˜¯å¦åœ¨è¿è¡Œ
â€¢ ç«¯å£ç›‘å¬ï¼šæ˜¯å¦ç›‘å¬æ­£ç¡®ç«¯å£  
â€¢ å“åº”æµ‹è¯•ï¼šèƒ½å¦æ­£å¸¸å“åº”è¯·æ±‚
â€¢ æ€§èƒ½æ£€æŸ¥ï¼šå“åº”æ—¶é—´æ˜¯å¦æ­£å¸¸
```

### 7.2 åŸºç¡€å¥åº·æ£€æŸ¥è„šæœ¬


**ğŸ” å¤šç»´åº¦å¥åº·æ£€æŸ¥**
```bash
#!/bin/bash
# æœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬

# æ£€æŸ¥å•ä¸ªæœåŠ¡å¥åº·çŠ¶æ€
check_service_health() {
    local service=$1
    local port=$2
    local url=$3
    
    echo "æ£€æŸ¥ $service æœåŠ¡å¥åº·çŠ¶æ€..."
    
    # 1. æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
    if ! systemctl is-active --quiet $service; then
        echo "âŒ $service è¿›ç¨‹æœªè¿è¡Œ"
        return 1
    fi
    
    # 2. æ£€æŸ¥ç«¯å£ç›‘å¬
    if [ -n "$port" ] && ! netstat -tlnp | grep -q ":$port "; then
        echo "âŒ $service ç«¯å£ $port æœªç›‘å¬"
        return 1
    fi
    
    # 3. æ£€æŸ¥HTTPå“åº”ï¼ˆå¦‚æœæœ‰URLï¼‰
    if [ -n "$url" ]; then
        if ! curl -s --max-time 10 "$url" >/dev/null; then
            echo "âŒ $service HTTPå“åº”å¼‚å¸¸"
            return 1
        fi
    fi
    
    echo "âœ… $service å¥åº·çŠ¶æ€æ­£å¸¸"
    return 0
}

# æ‰¹é‡å¥åº·æ£€æŸ¥
echo "=== å¼€å§‹æ‰¹é‡å¥åº·æ£€æŸ¥ ==="

# æ£€æŸ¥å„ä¸ªæœåŠ¡
check_service_health "nginx" "80" "http://localhost"
check_service_health "mysql" "3306" ""
check_service_health "redis" "6379" ""
check_service_health "php-fpm" "9000" ""

echo "=== å¥åº·æ£€æŸ¥å®Œæˆ ==="
```

### 7.3 é«˜çº§å¥åº·æ£€æŸ¥åŠŸèƒ½


**âš¡ æ€§èƒ½æŒ‡æ ‡ç›‘æ§**
```bash
# æ£€æŸ¥æœåŠ¡æ€§èƒ½æŒ‡æ ‡
check_service_performance() {
    local service=$1
    
    echo "æ£€æŸ¥ $service æ€§èƒ½æŒ‡æ ‡..."
    
    # CPUä½¿ç”¨ç‡
    cpu_usage=$(systemctl show $service --property=CPUUsageNSec | cut -d= -f2)
    
    # å†…å­˜ä½¿ç”¨é‡
    memory_usage=$(systemctl show $service --property=MemoryUsage | cut -d= -f2)
    
    # é‡å¯æ¬¡æ•°
    restart_count=$(systemctl show $service --property=NRestarts | cut -d= -f2)
    
    echo "ğŸ“Š $service æ€§èƒ½æŒ‡æ ‡:"
    echo "   å†…å­˜ä½¿ç”¨: $(($memory_usage / 1024 / 1024))MB"
    echo "   é‡å¯æ¬¡æ•°: $restart_count"
    
    # å¦‚æœæ˜¯WebæœåŠ¡ï¼Œæ£€æŸ¥å“åº”æ—¶é—´
    if [ "$service" = "nginx" ]; then
        response_time=$(curl -o /dev/null -s -w '%{time_total}\n' http://localhost)
        echo "   å“åº”æ—¶é—´: ${response_time}ç§’"
        
        # å“åº”æ—¶é—´è¶…è¿‡2ç§’æŠ¥è­¦
        if (( $(echo "$response_time > 2" | bc -l) )); then
            echo "âš ï¸  å“åº”æ—¶é—´è¿‡é•¿ï¼"
        fi
    fi
}
```

**ğŸš¨ å¥åº·æ£€æŸ¥æŠ¥è­¦æœºåˆ¶**
```bash
# å¥åº·æ£€æŸ¥å’ŒæŠ¥è­¦
health_check_with_alert() {
    local service=$1
    local alert_log="/var/log/service-alerts.log"
    
    if ! check_service_health $service; then
        # è®°å½•æŠ¥è­¦æ—¥å¿—
        echo "$(date): $service å¥åº·æ£€æŸ¥å¤±è´¥" >> $alert_log
        
        # å‘é€é‚®ä»¶æŠ¥è­¦ï¼ˆå¦‚æœé…ç½®äº†é‚®ä»¶ï¼‰
        if command -v mail >/dev/null; then
            echo "$service æœåŠ¡å¼‚å¸¸ï¼Œè¯·åŠæ—¶å¤„ç†" | \
            mail -s "æœåŠ¡æŠ¥è­¦: $service" admin@example.com
        fi
        
        # å°è¯•è‡ªåŠ¨é‡å¯æœåŠ¡
        echo "å°è¯•è‡ªåŠ¨é‡å¯ $service..."
        systemctl restart $service
        sleep 5
        
        # é‡å¯åå†æ¬¡æ£€æŸ¥
        if check_service_health $service; then
            echo "âœ… $service è‡ªåŠ¨æ¢å¤æˆåŠŸ"
        else
            echo "âŒ $service è‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥å¤„ç†"
        fi
    fi
}
```

---

## 8. ğŸ”„ æœåŠ¡æ•…éšœè‡ªåŠ¨æ¢å¤


### 8.1 ç†è§£è‡ªåŠ¨æ¢å¤æœºåˆ¶


**ğŸ”¸ ä»€ä¹ˆæ˜¯è‡ªåŠ¨æ¢å¤**
è‡ªåŠ¨æ¢å¤å°±æ˜¯å½“æœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨å°è¯•ä¿®å¤ï¼Œå°±åƒæ‰‹æœºæ­»æœºåè‡ªåŠ¨é‡å¯ä¸€æ ·ã€‚ç›®æ ‡æ˜¯å‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜ç³»ç»Ÿå¯ç”¨æ€§ã€‚

**ğŸ’¡ è‡ªåŠ¨æ¢å¤çš„ç­–ç•¥å±‚æ¬¡**
```
æ¢å¤ç­–ç•¥å±‚æ¬¡ï¼ˆä»ç®€å•åˆ°å¤æ‚ï¼‰ï¼š

1. æœåŠ¡é‡å¯ï¼šsystemctl restart service
   é€‚ç”¨ï¼šè¿›ç¨‹å´©æºƒã€å†…å­˜æ³„æ¼ç­‰

2. é…ç½®é‡è½½ï¼šsystemctl reload service  
   é€‚ç”¨ï¼šé…ç½®æ–‡ä»¶é”™è¯¯ã€è¿æ¥æ•°æ»¡ç­‰

3. ä¾èµ–é‡å¯ï¼šé‡å¯ä¾èµ–æœåŠ¡é“¾
   é€‚ç”¨ï¼šæ•°æ®åº“è¿æ¥æ–­å¼€ç­‰

4. ç³»ç»Ÿæ¢å¤ï¼šæ¸…ç†èµ„æºã€é‡ç½®ç¯å¢ƒ
   é€‚ç”¨ï¼šç£ç›˜æ»¡ã€ç«¯å£å†²çªç­‰

5. ä¸»å¤‡åˆ‡æ¢ï¼šåˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡
   é€‚ç”¨ï¼šç¡¬ä»¶æ•…éšœã€ç½‘ç»œä¸­æ–­ç­‰
```

### 8.2 systemdå†…ç½®æ¢å¤æœºåˆ¶


**âš™ï¸ é…ç½®æœåŠ¡è‡ªåŠ¨é‡å¯**
systemdæœ¬èº«å°±æä¾›äº†åŸºç¡€çš„è‡ªåŠ¨æ¢å¤åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š

```bash
# ç¼–è¾‘æœåŠ¡é…ç½®ï¼ˆä»¥nginxä¸ºä¾‹ï¼‰
systemctl edit nginx

# æ·»åŠ è‡ªåŠ¨é‡å¯é…ç½®
[Service]
Restart=always                    # æ€»æ˜¯é‡å¯
RestartSec=10                     # é‡å¯å‰ç­‰å¾…10ç§’
StartLimitInterval=60             # 60ç§’å†…
StartLimitBurst=3                 # æœ€å¤šé‡å¯3æ¬¡
```

**ğŸ“‹ é‡å¯ç­–ç•¥é€‰é¡¹è¯´æ˜**

| é‡å¯ç­–ç•¥ | å«ä¹‰ | é€‚ç”¨åœºæ™¯ |
|---------|------|----------|
| `no` | ä¸è‡ªåŠ¨é‡å¯ | æµ‹è¯•ç¯å¢ƒï¼Œé¿å…å½±å“è°ƒè¯• |
| `always` | æ€»æ˜¯é‡å¯ | å…³é”®æœåŠ¡ï¼Œå¿…é¡»ä¿æŒè¿è¡Œ |
| `on-failure` | å¤±è´¥æ—¶é‡å¯ | ä¸€èˆ¬æœåŠ¡ï¼Œæ­£å¸¸é€€å‡ºä¸é‡å¯ |
| `on-success` | æˆåŠŸæ—¶é‡å¯ | å®šæ—¶ä»»åŠ¡ï¼Œå®Œæˆåé‡æ–°å¯åŠ¨ |

### 8.3 é«˜çº§æ•…éšœæ¢å¤è„šæœ¬


**ğŸ› ï¸ æ™ºèƒ½æ¢å¤è„šæœ¬**
```bash
#!/bin/bash
# æœåŠ¡æ•…éšœæ™ºèƒ½æ¢å¤è„šæœ¬

RECOVERY_LOG="/var/log/service-recovery.log"

# æ—¥å¿—è®°å½•å‡½æ•°
log_recovery() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> $RECOVERY_LOG
}

# æ™ºèƒ½æ¢å¤å‡½æ•°
smart_recovery() {
    local service=$1
    local max_attempts=3
    local attempt=1
    
    log_recovery "å¼€å§‹æ¢å¤æœåŠ¡: $service"
    
    while [ $attempt -le $max_attempts ]; do
        echo "ç¬¬ $attempt æ¬¡æ¢å¤å°è¯•: $service"
        
        # æ­¥éª¤1: å°è¯•è½»é‡çº§é‡è½½
        if [ $attempt -eq 1 ]; then
            echo "å°è¯•é‡è½½é…ç½®..."
            systemctl reload $service 2>/dev/null
            sleep 5
            
            if systemctl is-active --quiet $service; then
                echo "âœ… é…ç½®é‡è½½æˆåŠŸæ¢å¤"
                log_recovery "$service é€šè¿‡é…ç½®é‡è½½æ¢å¤æˆåŠŸ"
                return 0
            fi
        fi
        
        # æ­¥éª¤2: æœåŠ¡é‡å¯
        echo "å°è¯•é‡å¯æœåŠ¡..."
        systemctl restart $service
        sleep 10
        
        if systemctl is-active --quiet $service; then
            echo "âœ… æœåŠ¡é‡å¯æˆåŠŸæ¢å¤"
            log_recovery "$service é€šè¿‡é‡å¯æ¢å¤æˆåŠŸ"
            return 0
        fi
        
        # æ­¥éª¤3: æ¸…ç†èµ„æºå¹¶é‡è¯•
        if [ $attempt -eq $max_attempts ]; then
            echo "å°è¯•æ¸…ç†èµ„æº..."
            
            # æ€æ­»å¯èƒ½æ®‹ç•™çš„è¿›ç¨‹
            pkill -f $service 2>/dev/null
            
            # æ¸…ç†å¯èƒ½çš„é”æ–‡ä»¶
            rm -f /var/run/${service}.pid 2>/dev/null
            rm -f /tmp/${service}.lock 2>/dev/null
            
            # ç­‰å¾…èµ„æºé‡Šæ”¾
            sleep 5
            
            # æœ€åä¸€æ¬¡é‡å¯å°è¯•
            systemctl restart $service
            sleep 10
        fi
        
        attempt=$((attempt + 1))
    done
    
    echo "âŒ $service æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥å¤„ç†"
    log_recovery "$service è‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥"
    return 1
}
```

**ğŸ”„ ä¾èµ–é“¾æ¢å¤**
```bash
# æŒ‰ä¾èµ–å…³ç³»æ¢å¤æœåŠ¡é“¾
recover_service_chain() {
    local failed_service=$1
    
    echo "æ£€æµ‹åˆ° $failed_service æ•…éšœï¼Œå¼€å§‹ä¾èµ–é“¾æ¢å¤..."
    
    case $failed_service in
        "mysql")
            echo "æ•°æ®åº“æ•…éšœï¼Œæ¢å¤æ•°æ®åº“ç›¸å…³æœåŠ¡é“¾..."
            smart_recovery "mysql"
            sleep 5
            smart_recovery "php-fpm"  # PHPå¯èƒ½éœ€è¦é‡æ–°è¿æ¥æ•°æ®åº“
            ;;
        "redis")
            echo "ç¼“å­˜æ•…éšœï¼Œæ¢å¤ç¼“å­˜ç›¸å…³æœåŠ¡..."
            smart_recovery "redis"
            smart_recovery "php-fpm"  # æ¸…ç†PHPè¿æ¥æ± 
            ;;
        "php-fpm")
            echo "åº”ç”¨æ•…éšœï¼Œæ¢å¤åº”ç”¨æœåŠ¡..."
            smart_recovery "php-fpm"
            systemctl reload nginx    # é‡è½½nginxé…ç½®
            ;;
        "nginx")
            echo "WebæœåŠ¡æ•…éšœï¼Œæ¢å¤WebæœåŠ¡..."
            smart_recovery "nginx"
            ;;
        *)
            smart_recovery $failed_service
            ;;
    esac
}
```

### 8.4 å®šæ—¶ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤


**â° å®šæ—¶å¥åº·æ£€æŸ¥å’Œæ¢å¤**
```bash
#!/bin/bash
# å®šæ—¶ç›‘æ§è„šæœ¬ï¼Œæ·»åŠ åˆ°crontabä¸­
# */5 * * * * /opt/scripts/auto-recovery.sh

SERVICES=("nginx" "mysql" "php-fpm" "redis")
MONITOR_LOG="/var/log/service-monitor.log"

echo "$(date): å¼€å§‹å®šæ—¶å¥åº·æ£€æŸ¥" >> $MONITOR_LOG

for service in "${SERVICES[@]}"; do
    if ! systemctl is-active --quiet $service; then
        echo "$(date): å‘ç° $service å¼‚å¸¸ï¼Œå¼€å§‹è‡ªåŠ¨æ¢å¤" >> $MONITOR_LOG
        recover_service_chain $service
        
        # æ¢å¤åéªŒè¯
        if systemctl is-active --quiet $service; then
            echo "$(date): $service è‡ªåŠ¨æ¢å¤æˆåŠŸ" >> $MONITOR_LOG
        else
            echo "$(date): $service è‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œå‘é€æŠ¥è­¦" >> $MONITOR_LOG
            # è¿™é‡Œå¯ä»¥æ·»åŠ æŠ¥è­¦é€šçŸ¥
        fi
    fi
done

echo "$(date): å®šæ—¶å¥åº·æ£€æŸ¥å®Œæˆ" >> $MONITOR_LOG
```

**ğŸ“ˆ æ¢å¤æˆåŠŸç‡ç»Ÿè®¡**
```bash
# ç»Ÿè®¡è‡ªåŠ¨æ¢å¤æˆåŠŸç‡
recovery_stats() {
    local log_file="/var/log/service-recovery.log"
    
    echo "=== è‡ªåŠ¨æ¢å¤ç»Ÿè®¡æŠ¥å‘Š ==="
    
    # ç»Ÿè®¡æœ€è¿‘24å°æ—¶çš„æ¢å¤æƒ…å†µ
    local total_attempts=$(grep -c "å¼€å§‹æ¢å¤æœåŠ¡" $log_file)
    local successful_recoveries=$(grep -c "æ¢å¤æˆåŠŸ" $log_file)
    local failed_recoveries=$(grep -c "æ¢å¤å¤±è´¥" $log_file)
    
    echo "æ€»æ¢å¤å°è¯•: $total_attempts"
    echo "æˆåŠŸæ¢å¤: $successful_recoveries"  
    echo "å¤±è´¥æ¢å¤: $failed_recoveries"
    
    if [ $total_attempts -gt 0 ]; then
        local success_rate=$((successful_recoveries * 100 / total_attempts))
        echo "æˆåŠŸç‡: ${success_rate}%"
    fi
    
    echo ""
    echo "=== æœ€è¿‘å¤±è´¥çš„æ¢å¤ ==="
    grep "æ¢å¤å¤±è´¥" $log_file | tail -5
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ æ‰¹é‡ç®¡ç†çš„æ ¸å¿ƒä»·å€¼**
```
ğŸ”¸ æ•ˆç‡æå‡ï¼šä¸€æ¡å‘½ä»¤ç®¡ç†å¤šä¸ªæœåŠ¡ï¼Œé¿å…é‡å¤æ“ä½œ
ğŸ”¸ ä¸€è‡´æ€§ä¿è¯ï¼šç¡®ä¿ç›¸å…³æœåŠ¡çŠ¶æ€ç»Ÿä¸€ï¼Œå‡å°‘é…ç½®å·®å¼‚  
ğŸ”¸ è‡ªåŠ¨åŒ–åŸºç¡€ï¼šä¸ºè¿ç»´è‡ªåŠ¨åŒ–è„šæœ¬æä¾›åŸºç¡€èƒ½åŠ›
ğŸ”¸ æ•…éšœæ¢å¤ï¼šå¿«é€Ÿæ‰¹é‡æ¢å¤æœåŠ¡ï¼Œé™ä½æ•…éšœå½±å“æ—¶é—´
ğŸ”¸ é…ç½®ç®¡ç†ï¼šç»Ÿä¸€ç®¡ç†é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œå¤‡ä»½
```

### 9.2 å…³é”®å‘½ä»¤å’ŒæŠ€å·§æ€»ç»“


**âš¡ å¿…ä¼šçš„æ‰¹é‡æ“ä½œå‘½ä»¤**
```bash
# åŸºç¡€æ‰¹é‡æ“ä½œ
systemctl start/stop/restart æœåŠ¡1 æœåŠ¡2 æœåŠ¡3
systemctl enable/disable æœåŠ¡1 æœåŠ¡2 æœåŠ¡3  
systemctl is-active æœåŠ¡1 æœåŠ¡2 æœåŠ¡3
systemctl is-enabled æœåŠ¡1 æœåŠ¡2 æœåŠ¡3

# çŠ¶æ€æŸ¥è¯¢
systemctl list-units --type=service --state=failed
systemctl list-unit-files --type=service --state=enabled

# æ—¥å¿—æŸ¥çœ‹
journalctl -u æœåŠ¡1 -u æœåŠ¡2 -f
journalctl -p err --since "1 hour ago"
```

**ğŸ› ï¸ å®ç”¨çš„ç®¡ç†æŠ€å·§**

| æŠ€å·§ç±»å‹ | å‘½ä»¤ç¤ºä¾‹ | ä½¿ç”¨åœºæ™¯ |
|---------|----------|----------|
| **é€šé…ç¬¦æ“ä½œ** | `systemctl stop php*` | æ‰¹é‡æ“ä½œç›¸ä¼¼æœåŠ¡ |
| **ä¾èµ–æŸ¥çœ‹** | `systemctl list-dependencies nginx` | äº†è§£æœåŠ¡ä¾èµ–å…³ç³» |
| **æ€§èƒ½ç›‘æ§** | `systemctl show nginx --property=MemoryUsage` | æ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µ |
| **é…ç½®ç¼–è¾‘** | `systemctl edit nginx` | ä¿®æ”¹æœåŠ¡é…ç½® |

### 9.3 æœ€ä½³å®è·µæŒ‡å—


**ğŸ“‹ æœåŠ¡ç®¡ç†æœ€ä½³å®è·µ**
- âœ… **å…ˆæµ‹è¯•åæ‰¹é‡**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åå†æ‰¹é‡æ“ä½œç”Ÿäº§ç¯å¢ƒ
- âœ… **å¤‡ä»½é…ç½®æ–‡ä»¶**ï¼šä¿®æ”¹é…ç½®å‰å¿…é¡»å¤‡ä»½åŸæ–‡ä»¶  
- âœ… **æ£€æŸ¥ä¾èµ–å…³ç³»**ï¼šäº†è§£æœåŠ¡é—´ä¾èµ–ï¼ŒæŒ‰æ­£ç¡®é¡ºåºæ“ä½œ
- âœ… **ç›‘æ§æ“ä½œç»“æœ**ï¼šæ‰¹é‡æ“ä½œåæ£€æŸ¥æ¯ä¸ªæœåŠ¡çŠ¶æ€
- âœ… **æ—¥å¿—è®°å½•æ“ä½œ**ï¼šé‡è¦æ“ä½œè¦è®°å½•æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜è¿½è¸ª

**âš ï¸ å¸¸è§è¯¯åŒºå’Œæ³¨æ„äº‹é¡¹**
- âŒ **é¿å…ç›²ç›®ä½¿ç”¨é€šé…ç¬¦**ï¼š`systemctl stop *sql*` å¯èƒ½å½±å“æ„å¤–æœåŠ¡
- âŒ **ä¸è¦å¿½ç•¥ä¾èµ–é¡ºåº**ï¼šæ•°æ®åº“åœæ­¢å‰åº”è¯¥å…ˆåœåº”ç”¨æœåŠ¡
- âŒ **é…ç½®å˜æ›´è¦æµ‹è¯•**ï¼šé…ç½®ä¿®æ”¹åè¦éªŒè¯æœåŠ¡èƒ½å¦æ­£å¸¸å¯åŠ¨
- âŒ **è‡ªåŠ¨æ¢å¤ä¸èƒ½è¿‡äºæ¿€è¿›**ï¼šé¿å…æ— é™é‡å¯å¾ªç¯

### 9.4 å®é™…åº”ç”¨åœºæ™¯æ€»ç»“


**ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯**

**Webç¯å¢ƒç®¡ç†ï¼š**
```bash
# Webç¯å¢ƒä¸€é”®å¯åŠ¨
systemctl enable --now nginx mysql php-fpm redis

# Webç¯å¢ƒå®‰å…¨å…³é—­  
systemctl stop nginx php-fpm mysql redis
```

**å¼€å‘ç¯å¢ƒå¿«é€Ÿåˆ‡æ¢ï¼š**
```bash
# å¼€å‘ç¯å¢ƒæœåŠ¡ç»„
DEV_SERVICES="nginx-dev mysql-dev redis-dev"
systemctl start $DEV_SERVICES

# ç”Ÿäº§ç¯å¢ƒæœåŠ¡ç»„
PROD_SERVICES="nginx mysql redis php-fpm"  
systemctl start $PROD_SERVICES
```

**æ•…éšœåº”æ€¥å¤„ç†ï¼š**
```bash
# å¿«é€Ÿé‡å¯æ‰€æœ‰Webç›¸å…³æœåŠ¡
systemctl restart nginx php-fpm mysql redis

# æ£€æŸ¥æ•…éšœæœåŠ¡å¹¶æ‰¹é‡é‡å¯
systemctl --failed --no-legend | awk '{print $1}' | xargs systemctl restart
```

### 9.5 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸš€ ç»§ç»­æ·±å…¥çš„æ–¹å‘**
- **å®¹å™¨åŒ–æœåŠ¡ç®¡ç†**ï¼šå­¦ä¹ Dockerå’ŒKubernetesçš„æœåŠ¡ç®¡ç†
- **é…ç½®ç®¡ç†å·¥å…·**ï¼šæŒæ¡Ansibleã€Puppetç­‰è‡ªåŠ¨åŒ–å·¥å…·
- **ç›‘æ§ä½“ç³»å»ºè®¾**ï¼šå­¦ä¹ Prometheusã€Grafanaç­‰ç›‘æ§å·¥å…·
- **æœåŠ¡ç½‘æ ¼**ï¼šäº†è§£Istioç­‰å¾®æœåŠ¡æ²»ç†å·¥å…·
- **CI/CDé›†æˆ**ï¼šå°†æœåŠ¡ç®¡ç†é›†æˆåˆ°æŒç»­é›†æˆæµæ°´çº¿

**ğŸ“š ç›¸å…³çŸ¥è¯†æ‰©å±•**
- **ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜**ï¼šæœåŠ¡æ€§èƒ½å‚æ•°ä¼˜åŒ–
- **é«˜å¯ç”¨æ¶æ„**ï¼šè´Ÿè½½å‡è¡¡ã€ä¸»å¤‡åˆ‡æ¢ã€é›†ç¾¤ç®¡ç†
- **å®‰å…¨ç®¡ç†**ï¼šæœåŠ¡æƒé™æ§åˆ¶ã€å®‰å…¨åŠ å›º
- **ç½‘ç»œç®¡ç†**ï¼šé˜²ç«å¢™è§„åˆ™ã€ç«¯å£ç®¡ç†

---

> ğŸ“ **å­¦ä¹ å»ºè®®**ï¼šæœåŠ¡æ‰¹é‡ç®¡ç†æ˜¯Linuxè¿ç»´çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œå»ºè®®å¤šåŠ¨æ‰‹å®è·µï¼Œåœ¨è™šæ‹Ÿæœºç¯å¢ƒä¸­åå¤ç»ƒä¹ å„ç§åœºæ™¯ã€‚æŒæ¡è¿™äº›æŠ€èƒ½åï¼Œå¯ä»¥å¤§å¤§æé«˜è¿ç»´æ•ˆç‡ï¼Œä¸ºè‡ªåŠ¨åŒ–è¿ç»´æ‰“ä¸‹åšå®åŸºç¡€ã€‚

> ğŸ’¡ **è®°å¿†è¦ç‚¹**ï¼š
> - æ‰¹é‡æ“ä½œææ•ˆç‡ï¼Œä¾èµ–é¡ºåºè¦ç‰¢è®°
> - å¥åº·æ£€æŸ¥é˜²æ•…éšœï¼Œè‡ªåŠ¨æ¢å¤ä¿ç¨³å®š  
> - é…ç½®ç»Ÿä¸€å¥½ç®¡ç†ï¼Œæ—¥å¿—é›†ä¸­ä¾¿åˆ†æ
> - å®‰å…¨æ“ä½œæ˜¯æ ¹æœ¬ï¼Œæµ‹è¯•éªŒè¯ä¸å¯å°‘