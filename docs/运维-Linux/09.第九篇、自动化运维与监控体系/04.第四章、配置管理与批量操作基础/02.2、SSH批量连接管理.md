---
title: 2ã€SSHæ‰¹é‡è¿æ¥ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [SSHæ‰¹é‡è¿æ¥ç®¡ç†æ¦‚è¿°](#1-SSHæ‰¹é‡è¿æ¥ç®¡ç†æ¦‚è¿°)
2. [SSHå¯†é’¥æ‰¹é‡åˆ†å‘](#2-SSHå¯†é’¥æ‰¹é‡åˆ†å‘)
3. [ssh-copy-idæ‰¹é‡éƒ¨ç½²](#3-ssh-copy-idæ‰¹é‡éƒ¨ç½²)
4. [SSHé…ç½®æ–‡ä»¶ç®¡ç†](#4-SSHé…ç½®æ–‡ä»¶ç®¡ç†)
5. [SSHè¿æ¥å¤ç”¨æŠ€æœ¯](#5-SSHè¿æ¥å¤ç”¨æŠ€æœ¯)
6. [æ‰¹é‡SSHæ‰§è¡Œå‘½ä»¤](#6-æ‰¹é‡SSHæ‰§è¡Œå‘½ä»¤)
7. [SSHéš§é“ä¸ç«¯å£è½¬å‘](#7-SSHéš§é“ä¸ç«¯å£è½¬å‘)
8. [è¿æ¥æ§åˆ¶ä¸ä¼˜åŒ–](#8-è¿æ¥æ§åˆ¶ä¸ä¼˜åŒ–)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ SSHæ‰¹é‡è¿æ¥ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯SSHæ‰¹é‡ç®¡ç†


**ğŸ”¸ ç®€å•ç†è§£**
æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªç½‘ç»œç®¡ç†å‘˜ï¼Œéœ€è¦ç®¡ç†100å°æœåŠ¡å™¨ã€‚å¦‚æœæ¯æ¬¡éƒ½è¦æ‰‹åŠ¨è¾“å…¥å¯†ç è¿æ¥æ¯å°æœåŠ¡å™¨ï¼Œé‚£ä¼šç´¯æ­»äººï¼SSHæ‰¹é‡ç®¡ç†å°±æ˜¯è®©ä½ èƒ½å¤Ÿ**ä¸€æ¬¡æ€§æ“ä½œå¤šå°æœåŠ¡å™¨**çš„æŠ€æœ¯ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š              æ‰¹é‡ç®¡ç†æ–¹å¼ï¼š
ssh user@server1  â†’    ä¸€æ¡å‘½ä»¤åŒæ—¶è¿æ¥
è¾“å…¥å¯†ç               â†’    æ‰€æœ‰æœåŠ¡å™¨è‡ªåŠ¨æ‰§è¡Œ
ssh user2@server2 â†’    çœæ—¶çœåŠ›ï¼Œæé«˜æ•ˆç‡
è¾“å…¥å¯†ç ...
```

**ğŸ”¸ æ ¸å¿ƒä»·å€¼**
- **æé«˜æ•ˆç‡**ï¼šä¸€æ¬¡æ“ä½œï¼Œæ‰¹é‡æ‰§è¡Œ
- **å‡å°‘é”™è¯¯**ï¼šé¿å…é‡å¤æ‰‹åŠ¨æ“ä½œ
- **ç»Ÿä¸€ç®¡ç†**ï¼šé›†ä¸­æ§åˆ¶å¤šå°æœåŠ¡å™¨
- **è‡ªåŠ¨åŒ–åŸºç¡€**ï¼šä¸ºè¿ç»´è‡ªåŠ¨åŒ–é“ºè·¯

### 1.2 SSHæ‰¹é‡ç®¡ç†çš„åº”ç”¨åœºæ™¯


**ğŸ’¼ å®é™…å·¥ä½œåœºæ™¯**
```
ğŸ¯ ç³»ç»Ÿæ›´æ–°ï¼šåŒæ—¶ç»™100å°æœåŠ¡å™¨å®‰è£…å®‰å…¨è¡¥ä¸
ğŸ¯ é…ç½®éƒ¨ç½²ï¼šæ‰¹é‡ä¿®æ”¹nginxé…ç½®æ–‡ä»¶
ğŸ¯ ç›‘æ§æ£€æŸ¥ï¼šä¸€æ¬¡æ€§æ£€æŸ¥æ‰€æœ‰æœåŠ¡å™¨çš„ç£ç›˜ä½¿ç”¨ç‡
ğŸ¯ æ—¥å¿—æ”¶é›†ï¼šä»å¤šå°æœåŠ¡å™¨æ”¶é›†ç‰¹å®šæ—¥å¿—
ğŸ¯ åº”ç”¨å‘å¸ƒï¼šåŒæ—¶åœ¨å¤šå°æœåŠ¡å™¨éƒ¨ç½²æ–°ç‰ˆæœ¬
```

### 1.3 æ‰¹é‡ç®¡ç†çš„æ ¸å¿ƒæŠ€æœ¯


**ğŸ”§ æŠ€æœ¯æ ˆç»„æˆ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ‰¹é‡æ‰§è¡Œå·¥å…·å±‚       â”‚ â† ansibleã€psshç­‰å·¥å…·
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    SSHé…ç½®ç®¡ç†å±‚       â”‚ â† ~/.ssh/configé…ç½®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    å¯†é’¥è®¤è¯å±‚          â”‚ â† å…¬é’¥ç§é’¥æ— å¯†ç è®¤è¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ç½‘ç»œä¼ è¾“å±‚          â”‚ â† SSHåè®®ã€è¿æ¥å¤ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”‘ SSHå¯†é’¥æ‰¹é‡åˆ†å‘


### 2.1 SSHå¯†é’¥è®¤è¯åŸç†


**ğŸ”¸ å¯†ç è®¤è¯ vs å¯†é’¥è®¤è¯å¯¹æ¯”**

```
å¯†ç è®¤è¯æ–¹å¼ï¼š                    å¯†é’¥è®¤è¯æ–¹å¼ï¼š
å®¢æˆ·ç«¯ â”€â”€â”€â”€å¯†ç â”€â”€â”€â”€â†’ æœåŠ¡å™¨        å®¢æˆ·ç«¯ â”€â”€â”€â”€å…¬é’¥â”€â”€â”€â”€â†’ æœåŠ¡å™¨
       "è¯·éªŒè¯123456"                   "ç”¨æˆ‘çš„å…¬é’¥éªŒè¯"
       
ç¼ºç‚¹ï¼š                           ä¼˜ç‚¹ï¼š
â€¢ æ¯æ¬¡éƒ½è¦è¾“å…¥å¯†ç                  â€¢ ä¸€æ¬¡é…ç½®ï¼Œæ°¸ä¹…å…å¯†
â€¢ å¯†ç å¯èƒ½è¢«ç ´è§£                  â€¢ æ›´åŠ å®‰å…¨å¯é 
â€¢ æ‰¹é‡æ“ä½œæ—¶å¾ˆéº»çƒ¦                â€¢ æ”¯æŒæ‰¹é‡è‡ªåŠ¨åŒ–
```

**ğŸ”¸ å¯†é’¥è®¤è¯å·¥ä½œæµç¨‹**
```
ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆå¯†é’¥å¯¹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç”Ÿæˆ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç§é’¥æ–‡ä»¶   â”‚ â†â”€â”€â”€â”€â”€â†’   â”‚   å…¬é’¥æ–‡ä»¶   â”‚
â”‚ id_rsa      â”‚           â”‚ id_rsa.pub  â”‚
â”‚ (ä¿å¯†ï¼)    â”‚           â”‚ (å¯ä»¥å…¬å¼€)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒæ­¥ï¼šå…¬é’¥éƒ¨ç½²åˆ°æœåŠ¡å™¨
å®¢æˆ·ç«¯å…¬é’¥ â”€â”€â”€â”€å¤åˆ¶â”€â”€â”€â”€â†’ æœåŠ¡å™¨~/.ssh/authorized_keys

ç¬¬ä¸‰æ­¥ï¼šå…å¯†ç ç™»å½•
å®¢æˆ·ç«¯ç”¨ç§é’¥ â”€â”€â”€â”€éªŒè¯â”€â”€â”€â”€â†’ æœåŠ¡å™¨ç”¨å…¬é’¥éªŒè¯ âœ“
```

### 2.2 ç”ŸæˆSSHå¯†é’¥å¯¹


**ğŸ”§ åŸºç¡€å¯†é’¥ç”Ÿæˆ**
```bash
# ç”Ÿæˆæ ‡å‡†RSAå¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096 -C "your-email@example.com"

# å‚æ•°è¯´æ˜ï¼š
# -t rsa     : æŒ‡å®šå¯†é’¥ç±»å‹ï¼ˆRSAç®—æ³•ï¼‰
# -b 4096    : å¯†é’¥é•¿åº¦4096ä½ï¼ˆæ›´å®‰å…¨ï¼‰
# -C "email" : æ·»åŠ æ³¨é‡Šï¼Œä¾¿äºè¯†åˆ«
```

**ğŸ’¡ äº¤äº’å¼ç”Ÿæˆè¿‡ç¨‹**
```
æ‰§è¡Œå‘½ä»¤åçš„äº¤äº’è¿‡ç¨‹ï¼š

Generating public/private rsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_rsa): 
â†‘ ç›´æ¥æŒ‰å›è½¦ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„

Enter passphrase (empty for no passphrase): 
â†‘ ç›´æ¥æŒ‰å›è½¦ï¼Œä¸è®¾ç½®å¯†ç çŸ­è¯­ï¼ˆæ‰¹é‡æ“ä½œéœ€è¦ï¼‰

Enter same passphrase again: 
â†‘ å†æ¬¡æŒ‰å›è½¦ç¡®è®¤

Your identification has been saved in /home/user/.ssh/id_rsa
Your public key has been saved in /home/user/.ssh/id_rsa.pub
```

**âš¡ å¿«é€Ÿæ‰¹é‡ç”Ÿæˆ**
```bash
# éäº¤äº’å¼ç”Ÿæˆï¼ˆæ‰¹é‡æ“ä½œé€‚ç”¨ï¼‰
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""

# å‚æ•°è§£é‡Šï¼š
# -f ~/.ssh/id_rsa : æŒ‡å®šä¿å­˜è·¯å¾„
# -N ""           : è®¾ç½®ç©ºå¯†ç çŸ­è¯­
```

### 2.3 å¯†é’¥æ–‡ä»¶ç®¡ç†


**ğŸ“ SSHç›®å½•ç»“æ„**
```
~/.ssh/
â”œâ”€â”€ id_rsa          â† ç§é’¥æ–‡ä»¶ï¼ˆæƒé™600ï¼Œä¸¥æ ¼ä¿å¯†ï¼‰
â”œâ”€â”€ id_rsa.pub      â† å…¬é’¥æ–‡ä»¶ï¼ˆæƒé™644ï¼Œå¯ä»¥å…¬å¼€ï¼‰
â”œâ”€â”€ authorized_keys â† æˆæƒå…¬é’¥åˆ—è¡¨ï¼ˆå…¶ä»–äººçš„å…¬é’¥ï¼‰
â”œâ”€â”€ known_hosts     â† å·²çŸ¥ä¸»æœºæŒ‡çº¹
â””â”€â”€ config          â† SSHå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
```

**ğŸ”’ æƒé™è®¾ç½®ï¼ˆé‡è¦ï¼ï¼‰**
```bash
# è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
chmod 700 ~/.ssh                    # SSHç›®å½•æƒé™
chmod 600 ~/.ssh/id_rsa            # ç§é’¥å¿…é¡»åªæœ‰è‡ªå·±èƒ½è¯»
chmod 644 ~/.ssh/id_rsa.pub        # å…¬é’¥å¯ä»¥å…¬å¼€è¯»å–
chmod 600 ~/.ssh/authorized_keys   # æˆæƒæ–‡ä»¶ä¿æŠ¤
chmod 644 ~/.ssh/known_hosts       # å·²çŸ¥ä¸»æœºè®°å½•
```

> âš ï¸ **æƒé™è­¦å‘Š**ï¼šå¦‚æœç§é’¥æƒé™ä¸å¯¹ï¼ˆæ¯”å¦‚644ï¼‰ï¼ŒSSHä¼šæ‹’ç»ä½¿ç”¨ï¼Œæç¤º"permissions too open"

### 2.4 æ‰¹é‡åˆ†å‘å…¬é’¥ç­–ç•¥


**ğŸ¯ åˆ†å‘æ–¹æ¡ˆä¸€ï¼šé€å°æ‰‹åŠ¨åˆ†å‘**
```bash
# é€‚åˆå°‘é‡æœåŠ¡å™¨ï¼ˆ< 10å°ï¼‰
ssh-copy-id user@192.168.1.10
ssh-copy-id user@192.168.1.11
ssh-copy-id user@192.168.1.12
```

**ğŸ¯ åˆ†å‘æ–¹æ¡ˆäºŒï¼šè„šæœ¬æ‰¹é‡åˆ†å‘**
```bash
#!/bin/bash
# æ‰¹é‡åˆ†å‘å…¬é’¥è„šæœ¬

servers="192.168.1.10 192.168.1.11 192.168.1.12"
username="root"

for server in $servers; do
    echo "æ­£åœ¨å‘ $server åˆ†å‘å…¬é’¥..."
    ssh-copy-id $username@$server
    if [ $? -eq 0 ]; then
        echo "âœ… $server åˆ†å‘æˆåŠŸ"
    else
        echo "âŒ $server åˆ†å‘å¤±è´¥"
    fi
done
```

**ğŸ¯ åˆ†å‘æ–¹æ¡ˆä¸‰ï¼šä»æ–‡ä»¶è¯»å–æœåŠ¡å™¨åˆ—è¡¨**
```bash
#!/bin/bash
# servers.txtæ–‡ä»¶å†…å®¹ï¼š
# 192.168.1.10
# 192.168.1.11 
# 192.168.1.12

while read -r server; do
    if [[ ! -z "$server" && ! "$server" =~ ^# ]]; then
        echo "åˆ†å‘å…¬é’¥åˆ°: $server"
        ssh-copy-id root@$server
    fi
done < servers.txt
```

---

## 3. ğŸš€ ssh-copy-idæ‰¹é‡éƒ¨ç½²


### 3.1 ssh-copy-idå·¥å…·è¯¦è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯ssh-copy-id**
`ssh-copy-id`æ˜¯SSHè‡ªå¸¦çš„å·¥å…·ï¼Œä¸“é—¨ç”¨æ¥æŠŠä½ çš„å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚å®ƒæ¯”æ‰‹åŠ¨å¤åˆ¶å…¬é’¥æ›´å®‰å…¨ã€æ›´æ–¹ä¾¿ã€‚

```
æ‰‹åŠ¨æ–¹å¼ï¼š                        ssh-copy-idæ–¹å¼ï¼š
1. cat ~/.ssh/id_rsa.pub       â†’  ssh-copy-id user@server
2. ssh user@server             â†’  ä¸€æ¡å‘½ä»¤æå®šï¼
3. mkdir -p ~/.ssh             â†’  è‡ªåŠ¨å¤„ç†æ‰€æœ‰ç»†èŠ‚
4. cat >> ~/.ssh/authorized_keys â†’  æƒé™ã€æ ¼å¼éƒ½ä¸ç”¨æ‹…å¿ƒ
5. chmod 600 ~/.ssh/authorized_keys
```

**ğŸ”§ åŸºç¡€ç”¨æ³•**
```bash
# æœ€ç®€å•çš„ç”¨æ³•
ssh-copy-id username@hostname

# æŒ‡å®šç«¯å£
ssh-copy-id -p 2222 username@hostname

# æŒ‡å®šå¯†é’¥æ–‡ä»¶
ssh-copy-id -i ~/.ssh/custom_key.pub username@hostname
```

### 3.2 ssh-copy-idé«˜çº§ç”¨æ³•


**ğŸ’¡ å¤„ç†ç‰¹æ®Šæƒ…å†µ**
```bash
# 1. æœåŠ¡å™¨SSHç«¯å£ä¸æ˜¯22
ssh-copy-id -p 2222 root@192.168.1.10

# 2. ä½¿ç”¨ç‰¹å®šçš„å¯†é’¥æ–‡ä»¶
ssh-copy-id -i ~/.ssh/backup_key.pub admin@server.com

# 3. å¼ºåˆ¶è¦†ç›–å·²æœ‰å…¬é’¥
ssh-copy-id -f -i ~/.ssh/id_rsa.pub user@hostname

# 4. è¯¦ç»†è¾“å‡ºï¼ˆè°ƒè¯•ç”¨ï¼‰
ssh-copy-id -v user@hostname
```

**ğŸ“‹ å¸¸è§å‚æ•°è¯´æ˜**
```
-i identity_file  : æŒ‡å®šå…¬é’¥æ–‡ä»¶è·¯å¾„
-p port          : æŒ‡å®šSSHç«¯å£å·
-o ssh_option    : ä¼ é€’SSHé€‰é¡¹
-f              : å¼ºåˆ¶æ¨¡å¼ï¼Œä¸æ£€æŸ¥å¯†é’¥æ˜¯å¦å·²å­˜åœ¨
-n              : åªæ˜¾ç¤ºè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸å®é™…æ‰§è¡Œ
-h              : æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
-v              : è¯¦ç»†è¾“å‡ºæ¨¡å¼
```

### 3.3 æ‰¹é‡éƒ¨ç½²å®æˆ˜


**ğŸ¯ æ‰¹é‡éƒ¨ç½²è„šæœ¬v1.0**
```bash
#!/bin/bash
# ç®€å•æ‰¹é‡éƒ¨ç½²è„šæœ¬

# æœåŠ¡å™¨åˆ—è¡¨
SERVERS=(
    "192.168.1.10"
    "192.168.1.11"
    "192.168.1.12"
    "192.168.1.13"
)

USERNAME="root"
PORT="22"

echo "ğŸš€ å¼€å§‹æ‰¹é‡åˆ†å‘SSHå…¬é’¥..."

for server in "${SERVERS[@]}"; do
    echo "ğŸ“¤ æ­£åœ¨å¤„ç†æœåŠ¡å™¨: $server"
    
    # ä½¿ç”¨ssh-copy-idåˆ†å‘å…¬é’¥
    ssh-copy-id -p $PORT $USERNAME@$server
    
    if [ $? -eq 0 ]; then
        echo "âœ… $server - å…¬é’¥åˆ†å‘æˆåŠŸ"
    else
        echo "âŒ $server - å…¬é’¥åˆ†å‘å¤±è´¥"
    fi
    echo "---"
done

echo "ğŸ‰ æ‰¹é‡åˆ†å‘å®Œæˆï¼"
```

**ğŸ¯ å¢å¼ºç‰ˆæ‰¹é‡éƒ¨ç½²è„šæœ¬v2.0**
```bash
#!/bin/bash
# å¢å¼ºç‰ˆæ‰¹é‡éƒ¨ç½²è„šæœ¬

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# é…ç½®æ–‡ä»¶
CONFIG_FILE="ssh_servers.conf"
LOG_FILE="ssh_deploy_$(date +%Y%m%d_%H%M%S).log"

# åˆ›å»ºé…ç½®æ–‡ä»¶ç¤ºä¾‹
if [ ! -f "$CONFIG_FILE" ]; then
    cat > "$CONFIG_FILE" << EOF
# SSHæœåŠ¡å™¨é…ç½®æ–‡ä»¶
# æ ¼å¼ï¼šIPåœ°å€:ç«¯å£:ç”¨æˆ·å
192.168.1.10:22:root
192.168.1.11:2222:admin
192.168.1.12:22:ubuntu
EOF
    echo -e "${YELLOW}å·²åˆ›å»ºé…ç½®æ–‡ä»¶: $CONFIG_FILE${NC}"
    echo "è¯·ç¼–è¾‘é…ç½®æ–‡ä»¶åé‡æ–°è¿è¡Œ"
    exit 0
fi

# ç»Ÿè®¡å˜é‡
SUCCESS_COUNT=0
FAIL_COUNT=0

echo -e "${GREEN}ğŸš€ SSHå…¬é’¥æ‰¹é‡éƒ¨ç½²å·¥å…· v2.0${NC}"
echo "ğŸ“‹ æ—¥å¿—æ–‡ä»¶: $LOG_FILE"
echo "â° å¼€å§‹æ—¶é—´: $(date)"
echo "=================="

while IFS=':' read -r ip port user || [ -n "$ip" ]; do
    # è·³è¿‡æ³¨é‡Šå’Œç©ºè¡Œ
    [[ "$ip" =~ ^#.*$ ]] && continue
    [[ -z "$ip" ]] && continue
    
    echo -e "${YELLOW}ğŸ“¤ å¤„ç†æœåŠ¡å™¨: $user@$ip:$port${NC}"
    
    # æ‰§è¡Œssh-copy-id
    {
        echo "$(date): å¼€å§‹å¤„ç† $user@$ip:$port"
        timeout 30 ssh-copy-id -p "$port" "$user@$ip" 2>&1
        result=$?
        echo "$(date): å¤„ç†ç»“æœ $result"
    } >> "$LOG_FILE"
    
    if [ $result -eq 0 ]; then
        echo -e "${GREEN}âœ… $ip - æˆåŠŸ${NC}"
        ((SUCCESS_COUNT++))
    else
        echo -e "${RED}âŒ $ip - å¤±è´¥${NC}"
        ((FAIL_COUNT++))
    fi
    echo "---"
    
done < "$CONFIG_FILE"

echo "=================="
echo -e "${GREEN}ğŸ‰ éƒ¨ç½²å®Œæˆï¼${NC}"
echo "âœ… æˆåŠŸ: $SUCCESS_COUNT å°"
echo "âŒ å¤±è´¥: $FAIL_COUNT å°"
echo "ğŸ“‹ è¯¦ç»†æ—¥å¿—: $LOG_FILE"
```

### 3.4 æ•…éšœæ’é™¤


**ğŸ”§ å¸¸è§é—®é¢˜åŠè§£å†³**

**é—®é¢˜1ï¼šPermission denied (publickey)**
```bash
# åŸå› ï¼šæœåŠ¡å™¨ä¸å…è®¸å¯†ç ç™»å½•ï¼Œä½†å…¬é’¥è¿˜æ²¡åˆ†å‘
# è§£å†³ï¼šå…ˆç”¨å¯†ç ç™»å½•ï¼Œæ‰‹åŠ¨æ·»åŠ å…¬é’¥
ssh user@server
mkdir -p ~/.ssh
chmod 700 ~/.ssh
# ç„¶åæ‰‹åŠ¨å¤åˆ¶å…¬é’¥å†…å®¹åˆ° ~/.ssh/authorized_keys
```

**é—®é¢˜2ï¼šHost key verification failed**
```bash
# åŸå› ï¼šæœåŠ¡å™¨æŒ‡çº¹å‘ç”Ÿå˜åŒ–
# è§£å†³ï¼šæ¸…é™¤æ—§çš„ä¸»æœºæŒ‡çº¹
ssh-keygen -R hostname
# æˆ–è€…åˆ é™¤ ~/.ssh/known_hosts ä¸­å¯¹åº”è¡Œ
```

**é—®é¢˜3ï¼šssh-copy-idå‘½ä»¤ä¸å­˜åœ¨**
```bash
# åœ¨æŸäº›ç³»ç»Ÿä¸Šssh-copy-idå¯èƒ½ä¸å­˜åœ¨
# æ‰‹åŠ¨å®ç°ç›¸åŒåŠŸèƒ½ï¼š
cat ~/.ssh/id_rsa.pub | ssh user@hostname 'mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys'
```

---

## 4. âš™ï¸ SSHé…ç½®æ–‡ä»¶ç®¡ç†


### 4.1 ~/.ssh/configæ–‡ä»¶è¯¦è§£


**ğŸ”¸ é…ç½®æ–‡ä»¶çš„ä½œç”¨**
`~/.ssh/config`æ–‡ä»¶å¯ä»¥è®©ä½ ä¸ºæ¯å°æœåŠ¡å™¨è®¾ç½®**åˆ«å**å’Œ**é»˜è®¤å‚æ•°**ï¼Œå°±åƒç»™æœåŠ¡å™¨èµ·ä¸ªå¥½è®°çš„æ˜µç§°ï¼Œå¹¶ä¸”è®°ä½å®ƒçš„"ä¸ªäººå–œå¥½"ã€‚

```
æ²¡æœ‰configæ–‡ä»¶æ—¶ï¼š
ssh -p 2222 admin@192.168.1.100 -i ~/.ssh/special_key

æœ‰äº†configæ–‡ä»¶åï¼š
ssh myserver  # ä¸€ä¸ªç®€å•å‘½ä»¤å°±æå®šï¼
```

**ğŸ”§ åŸºç¡€é…ç½®ç¤ºä¾‹**
```bash
# ~/.ssh/configæ–‡ä»¶å†…å®¹
Host myserver
    HostName 192.168.1.100
    Port 2222
    User admin
    IdentityFile ~/.ssh/special_key

# ä½¿ç”¨æ—¶åªéœ€è¦ï¼š
ssh myserver
```

### 4.2 é…ç½®æ–‡ä»¶è¯­æ³•è¯¦è§£


**ğŸ“‹ å¸¸ç”¨é…ç½®é¡¹è¯´æ˜**
```bash
# æœåŠ¡å™¨é…ç½®å—
Host åˆ«å
    HostName çœŸå®IPæˆ–åŸŸå
    Port SSHç«¯å£å·
    User ç”¨æˆ·å
    IdentityFile ç§é’¥æ–‡ä»¶è·¯å¾„
    IdentitiesOnly yes
```

**ğŸ’¡ å®é™…é…ç½®ç¤ºä¾‹**
```bash
# ~/.ssh/config

# ç”Ÿäº§æœåŠ¡å™¨
Host prod-web
    HostName 10.0.1.10
    Port 22
    User root
    IdentityFile ~/.ssh/prod_key
    IdentitiesOnly yes

# æµ‹è¯•æœåŠ¡å™¨
Host test-web
    HostName 192.168.1.20
    Port 2222
    User ubuntu
    IdentityFile ~/.ssh/test_key

# å¼€å‘æœåŠ¡å™¨
Host dev-web
    HostName dev.company.com
    Port 22
    User developer
    IdentityFile ~/.ssh/dev_key
    
# è·³æ¿æœºé…ç½®
Host jumpserver
    HostName jump.company.com
    Port 22
    User admin
    IdentityFile ~/.ssh/jump_key
```

### 4.3 æ‰¹é‡é…ç½®ç®¡ç†


**ğŸ¯ é€šé…ç¬¦é…ç½®**
```bash
# ä¸ºæ‰€æœ‰æœåŠ¡å™¨è®¾ç½®é€šç”¨é…ç½®
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    LogLevel QUIET

# ä¸ºç‰¹å®šç½‘æ®µè®¾ç½®é…ç½®
Host 192.168.1.*
    User root
    Port 22
    IdentityFile ~/.ssh/internal_key

# ä¸ºç”Ÿäº§ç¯å¢ƒè®¾ç½®é…ç½®
Host prod-*
    User root
    IdentitiesOnly yes
    ServerAliveInterval 30
```

**ğŸ”§ è‡ªåŠ¨åŒ–é…ç½®ç”Ÿæˆè„šæœ¬**
```bash
#!/bin/bash
# SSHé…ç½®è‡ªåŠ¨ç”Ÿæˆè„šæœ¬

CONFIG_FILE="$HOME/.ssh/config"
BACKUP_FILE="$HOME/.ssh/config.backup.$(date +%Y%m%d_%H%M%S)"

# å¤‡ä»½ç°æœ‰é…ç½®
if [ -f "$CONFIG_FILE" ]; then
    cp "$CONFIG_FILE" "$BACKUP_FILE"
    echo "å·²å¤‡ä»½ç°æœ‰é…ç½®åˆ°: $BACKUP_FILE"
fi

# ç”Ÿæˆæ–°é…ç½®
cat > "$CONFIG_FILE" << 'EOF'
# SSHå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
# è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·è°¨æ…æ‰‹åŠ¨ä¿®æ”¹

# å…¨å±€é»˜è®¤è®¾ç½®
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3
    Compression yes
    TCPKeepAlive yes

# ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨
Host prod-web01
    HostName 10.0.1.10
    Port 22
    User root
    IdentityFile ~/.ssh/prod_key

Host prod-web02
    HostName 10.0.1.11
    Port 22
    User root
    IdentityFile ~/.ssh/prod_key

# æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨
Host test-web01
    HostName 192.168.1.10
    Port 22
    User ubuntu
    IdentityFile ~/.ssh/test_key

# å¼€å‘ç¯å¢ƒæœåŠ¡å™¨
Host dev-web01
    HostName 192.168.2.10
    Port 22
    User developer
    IdentityFile ~/.ssh/dev_key

EOF

# è®¾ç½®æ­£ç¡®æƒé™
chmod 600 "$CONFIG_FILE"
echo "âœ… SSHé…ç½®æ–‡ä»¶ç”Ÿæˆå®Œæˆ: $CONFIG_FILE"
echo "ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨åˆ«åè¿æ¥æœåŠ¡å™¨ï¼Œæ¯”å¦‚: ssh prod-web01"
```

### 4.4 é«˜çº§é…ç½®æŠ€å·§


**ğŸ¯ è·³æ¿æœºé…ç½®ï¼ˆProxyJumpï¼‰**
```bash
# é€šè¿‡è·³æ¿æœºè®¿é—®å†…ç½‘æœåŠ¡å™¨
Host internal-server
    HostName 10.0.0.100
    User root
    ProxyJump jumpserver
    IdentityFile ~/.ssh/internal_key

Host jumpserver
    HostName jump.company.com
    User admin
    IdentityFile ~/.ssh/jump_key

# ä½¿ç”¨æ—¶ç›´æ¥ï¼šssh internal-server
# SSHä¼šè‡ªåŠ¨å…ˆè¿è·³æ¿æœºï¼Œå†è¿å†…ç½‘æœåŠ¡å™¨
```

**ğŸ¯ è¿æ¥å¤ç”¨é…ç½®**
```bash
# è¿æ¥å¤ç”¨é…ç½®ï¼ˆæé«˜è¿æ¥é€Ÿåº¦ï¼‰
Host *
    ControlMaster auto
    ControlPath ~/.ssh/sockets/%r@%h:%p
    ControlPersist 600

# éœ€è¦åˆ›å»ºsocketsç›®å½•
# mkdir -p ~/.ssh/sockets
```

**ğŸ¯ æŒ‰ç¯å¢ƒåˆ†ç»„é…ç½®**
```bash
# ~/.ssh/config

# ç”Ÿäº§ç¯å¢ƒé…ç½®
Host prod-*
    User root
    Port 22
    IdentityFile ~/.ssh/prod_key
    IdentitiesOnly yes
    StrictHostKeyChecking yes

# æµ‹è¯•ç¯å¢ƒé…ç½®
Host test-*
    User ubuntu
    Port 22
    IdentityFile ~/.ssh/test_key
    StrictHostKeyChecking no

# å¼€å‘ç¯å¢ƒé…ç½®
Host dev-*
    User developer
    Port 22
    IdentityFile ~/.ssh/dev_key
    StrictHostKeyChecking no
```

---

## 5. ğŸ”„ SSHè¿æ¥å¤ç”¨æŠ€æœ¯


### 5.1 ä»€ä¹ˆæ˜¯SSHè¿æ¥å¤ç”¨


**ğŸ”¸ è¿æ¥å¤ç”¨åŸç†**
SSHè¿æ¥å¤ç”¨å°±åƒæ˜¯åœ¨ä½ å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡"é«˜é€Ÿå…¬è·¯"ï¼Œä¸€æ—¦å»ºç«‹åï¼Œåç»­çš„è¿æ¥å¯ä»¥**å…±äº«è¿™æ¡é€šé“**ï¼Œè€Œä¸éœ€è¦é‡æ–°"ä¿®è·¯"ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆæ¯æ¬¡æ–°å»ºè¿æ¥ï¼‰ï¼š
è¿æ¥1: å®¢æˆ·ç«¯ â”€â”€â”€â”€æ–°å»ºè¿æ¥â”€â”€â”€â”€â†’ æœåŠ¡å™¨ (è€—æ—¶3ç§’)
è¿æ¥2: å®¢æˆ·ç«¯ â”€â”€â”€â”€æ–°å»ºè¿æ¥â”€â”€â”€â”€â†’ æœåŠ¡å™¨ (è€—æ—¶3ç§’)  
è¿æ¥3: å®¢æˆ·ç«¯ â”€â”€â”€â”€æ–°å»ºè¿æ¥â”€â”€â”€â”€â†’ æœåŠ¡å™¨ (è€—æ—¶3ç§’)

è¿æ¥å¤ç”¨æ–¹å¼ï¼š
ä¸»è¿æ¥: å®¢æˆ·ç«¯ â•â•â•å»ºç«‹ä¸»é€šé“â•â•â•â†’ æœåŠ¡å™¨ (è€—æ—¶3ç§’)
è¿æ¥2: å®¢æˆ·ç«¯ â”€â”€å…±äº«ä¸»é€šé“â”€â”€â†’ æœåŠ¡å™¨ (è€—æ—¶0.1ç§’)
è¿æ¥3: å®¢æˆ·ç«¯ â”€â”€å…±äº«ä¸»é€šé“â”€â”€â†’ æœåŠ¡å™¨ (è€—æ—¶0.1ç§’)
```

**ğŸ’¡ è¿æ¥å¤ç”¨çš„å¥½å¤„**
- **é€Ÿåº¦å¿«**ï¼šåç»­è¿æ¥å‡ ä¹ç¬æ—¶å®Œæˆ
- **å‡å°‘èµ„æºæ¶ˆè€—**ï¼šæœåŠ¡å™¨ç«¯å‡å°‘è¿æ¥å¼€é”€
- **æ‰¹é‡æ“ä½œæ›´é«˜æ•ˆ**ï¼šç‰¹åˆ«é€‚åˆé¢‘ç¹SSHæ“ä½œ

### 5.2 é…ç½®è¿æ¥å¤ç”¨


**ğŸ”§ åŸºç¡€å¤ç”¨é…ç½®**
```bash
# ~/.ssh/config
Host *
    ControlMaster auto
    ControlPath ~/.ssh/sockets/%r@%h:%p
    ControlPersist 600
```

**ğŸ“‹ é…ç½®å‚æ•°è¯¦è§£**
```
ControlMaster auto    : è‡ªåŠ¨å¯ç”¨ä¸»è¿æ¥æ§åˆ¶
ControlPath          : æ§åˆ¶å¥—æ¥å­—æ–‡ä»¶è·¯å¾„
                      %r = ç”¨æˆ·å, %h = ä¸»æœºå, %p = ç«¯å£
ControlPersist 600   : ä¸»è¿æ¥ä¿æŒæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œ600=10åˆ†é’Ÿ
```

**ğŸ”§ åˆ›å»ºå¿…è¦ç›®å½•**
```bash
# åˆ›å»ºsocketsç›®å½•
mkdir -p ~/.ssh/sockets
chmod 700 ~/.ssh/sockets
```

### 5.3 è¿æ¥å¤ç”¨å®æˆ˜


**ğŸ¯ æµ‹è¯•è¿æ¥å¤ç”¨æ•ˆæœ**
```bash
# ç¬¬ä¸€æ¬¡è¿æ¥ï¼ˆå»ºç«‹ä¸»è¿æ¥ï¼‰
time ssh myserver 'echo "ç¬¬ä¸€æ¬¡è¿æ¥"'
# è¾“å‡ºï¼šreal 0m2.341s ï¼ˆè¾ƒæ…¢ï¼Œéœ€è¦å»ºç«‹è¿æ¥ï¼‰

# ç¬¬äºŒæ¬¡è¿æ¥ï¼ˆä½¿ç”¨å¤ç”¨ï¼‰
time ssh myserver 'echo "ç¬¬äºŒæ¬¡è¿æ¥"'  
# è¾“å‡ºï¼šreal 0m0.123s ï¼ˆå¾ˆå¿«ï¼ï¼‰

# ç¬¬ä¸‰æ¬¡è¿æ¥ï¼ˆä½¿ç”¨å¤ç”¨ï¼‰
time ssh myserver 'echo "ç¬¬ä¸‰æ¬¡è¿æ¥"'
# è¾“å‡ºï¼šreal 0m0.098s ï¼ˆå¾ˆå¿«ï¼ï¼‰
```

**ğŸ¯ ç®¡ç†å¤ç”¨è¿æ¥**
```bash
# æŸ¥çœ‹å½“å‰çš„å¤ç”¨è¿æ¥
ssh -O check myserver

# æ‰‹åŠ¨åœæ­¢å¤ç”¨è¿æ¥
ssh -O stop myserver

# æŸ¥çœ‹å¤ç”¨è¿æ¥çŠ¶æ€
ls -la ~/.ssh/sockets/
```

### 5.4 é«˜çº§å¤ç”¨é…ç½®


**ğŸ¯ é’ˆå¯¹ä¸åŒæœåŠ¡å™¨çš„å¤ç”¨ç­–ç•¥**
```bash
# ~/.ssh/config

# ç”Ÿäº§æœåŠ¡å™¨ï¼šé•¿æ—¶é—´ä¿æŒè¿æ¥
Host prod-*
    ControlMaster auto
    ControlPath ~/.ssh/sockets/prod_%r@%h:%p
    ControlPersist 1800  # 30åˆ†é’Ÿ

# æµ‹è¯•æœåŠ¡å™¨ï¼šä¸­ç­‰æ—¶é—´ä¿æŒè¿æ¥
Host test-*
    ControlMaster auto  
    ControlPath ~/.ssh/sockets/test_%r@%h:%p
    ControlPersist 600   # 10åˆ†é’Ÿ

# ä¸´æ—¶æœåŠ¡å™¨ï¼šçŸ­æ—¶é—´ä¿æŒè¿æ¥
Host temp-*
    ControlMaster auto
    ControlPath ~/.ssh/sockets/temp_%r@%h:%p  
    ControlPersist 60    # 1åˆ†é’Ÿ
```

**ğŸ”§ å¤ç”¨è¿æ¥æ¸…ç†è„šæœ¬**
```bash
#!/bin/bash
# SSHè¿æ¥å¤ç”¨æ¸…ç†è„šæœ¬

SOCKET_DIR="$HOME/.ssh/sockets"

if [ ! -d "$SOCKET_DIR" ]; then
    echo "Socketç›®å½•ä¸å­˜åœ¨: $SOCKET_DIR"
    exit 1
fi

echo "ğŸ§¹ æ¸…ç†SSHå¤ç”¨è¿æ¥..."

# ç»Ÿè®¡æ¸…ç†å‰çš„è¿æ¥æ•°
OLD_COUNT=$(ls -1 "$SOCKET_DIR" 2>/dev/null | wc -l)

# æ¸…ç†æ‰€æœ‰socketæ–‡ä»¶
for socket in "$SOCKET_DIR"/*; do
    if [ -S "$socket" ]; then
        echo "æ¸…ç†: $(basename "$socket")"
        rm -f "$socket"
    fi
done

# ç»Ÿè®¡æ¸…ç†åçš„è¿æ¥æ•°
NEW_COUNT=$(ls -1 "$SOCKET_DIR" 2>/dev/null | wc -l)

echo "âœ… æ¸…ç†å®Œæˆï¼"
echo "æ¸…ç†å‰: $OLD_COUNT ä¸ªè¿æ¥"
echo "æ¸…ç†å: $NEW_COUNT ä¸ªè¿æ¥"
```

### 5.5 è¿æ¥å¤ç”¨ç›‘æ§


**ğŸ“Š å¤ç”¨è¿æ¥ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# SSHè¿æ¥å¤ç”¨ç›‘æ§è„šæœ¬

SOCKET_DIR="$HOME/.ssh/sockets"

echo "ğŸ” SSHè¿æ¥å¤ç”¨çŠ¶æ€ç›‘æ§"
echo "===================="

if [ ! -d "$SOCKET_DIR" ] || [ -z "$(ls -A "$SOCKET_DIR" 2>/dev/null)" ]; then
    echo "âŒ æ²¡æœ‰æ´»è·ƒçš„å¤ç”¨è¿æ¥"
    exit 0
fi

printf "%-20s %-15s %-10s %-20s\n" "è¿æ¥åç§°" "çŠ¶æ€" "å¤§å°" "ä¿®æ”¹æ—¶é—´"
echo "----------------------------------------------------------------"

for socket in "$SOCKET_DIR"/*; do
    if [ -S "$socket" ]; then
        name=$(basename "$socket")
        size=$(stat -c%s "$socket" 2>/dev/null || echo "0")
        mtime=$(stat -c%Y "$socket" 2>/dev/null || echo "0")
        mtime_readable=$(date -d @$mtime "+%m-%d %H:%M" 2>/dev/null || echo "unknown")
        
        # æ£€æŸ¥è¿æ¥æ˜¯å¦è¿˜æ´»è·ƒ
        if [ -w "$socket" ]; then
            status="âœ… æ´»è·ƒ"
        else
            status="âŒ æ–­å¼€"
        fi
        
        printf "%-20s %-15s %-10s %-20s\n" "$name" "$status" "${size}B" "$mtime_readable"
    fi
done

echo "===================="
echo "æ€»è¿æ¥æ•°: $(ls -1 "$SOCKET_DIR" 2>/dev/null | wc -l)"
```

---

## 6. âš¡ æ‰¹é‡SSHæ‰§è¡Œå‘½ä»¤


### 6.1 å•æœåŠ¡å™¨å‘½ä»¤æ‰§è¡Œ


**ğŸ”¸ åŸºç¡€å‘½ä»¤æ‰§è¡Œ**
```bash
# åœ¨è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œå•æ¡å‘½ä»¤
ssh user@server 'ls -la'

# æ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼ˆç”¨åˆ†å·åˆ†éš”ï¼‰
ssh user@server 'cd /var/log; ls -la; tail -5 syslog'

# æ‰§è¡Œå¤æ‚å‘½ä»¤ï¼ˆç”¨å¼•å·ä¿æŠ¤ï¼‰
ssh user@server 'ps aux | grep nginx | grep -v grep'
```

**ğŸ”¸ æœ¬åœ°è„šæœ¬è¿œç¨‹æ‰§è¡Œ**
```bash
# æ–¹æ³•1ï¼šç®¡é“æ–¹å¼
cat local_script.sh | ssh user@server 'bash -s'

# æ–¹æ³•2ï¼šé‡å®šå‘æ–¹å¼  
ssh user@server 'bash -s' < local_script.sh

# æ–¹æ³•3ï¼šä¼ é€’å‚æ•°
ssh user@server 'bash -s arg1 arg2' < local_script.sh
```

### 6.2 æ‰¹é‡å‘½ä»¤æ‰§è¡Œå·¥å…·


**ğŸ¯ ç®€å•æ‰¹é‡æ‰§è¡Œè„šæœ¬**
```bash
#!/bin/bash
# ç®€å•æ‰¹é‡SSHå‘½ä»¤æ‰§è¡Œ

# æœåŠ¡å™¨åˆ—è¡¨
SERVERS=(
    "user@192.168.1.10"
    "user@192.168.1.11" 
    "user@192.168.1.12"
)

# è¦æ‰§è¡Œçš„å‘½ä»¤
COMMAND="df -h"

echo "ğŸš€ æ‰¹é‡æ‰§è¡Œå‘½ä»¤: $COMMAND"
echo "===================="

for server in "${SERVERS[@]}"; do
    echo "ğŸ“¡ æ‰§è¡ŒæœåŠ¡å™¨: $server"
    ssh "$server" "$COMMAND"
    echo "---"
done
```

**ğŸ¯ å¹¶å‘æ‰¹é‡æ‰§è¡Œè„šæœ¬**
```bash
#!/bin/bash
# å¹¶å‘æ‰¹é‡SSHå‘½ä»¤æ‰§è¡Œ

# æœåŠ¡å™¨åˆ—è¡¨æ–‡ä»¶
SERVER_FILE="servers.txt"
COMMAND="uptime"
MAX_JOBS=5  # æœ€å¤§å¹¶å‘æ•°

# æ‰§è¡Œå‡½æ•°
execute_ssh() {
    local server=$1
    local cmd=$2
    echo "ğŸ”„ [$server] å¼€å§‹æ‰§è¡Œ..."
    
    result=$(ssh -o ConnectTimeout=10 "$server" "$cmd" 2>&1)
    status=$?
    
    if [ $status -eq 0 ]; then
        echo "âœ… [$server] æ‰§è¡ŒæˆåŠŸ:"
        echo "$result"
    else
        echo "âŒ [$server] æ‰§è¡Œå¤±è´¥:"
        echo "$result"
    fi
    echo "---"
}

echo "ğŸš€ å¹¶å‘æ‰¹é‡æ‰§è¡Œå‘½ä»¤: $COMMAND"
echo "æœ€å¤§å¹¶å‘æ•°: $MAX_JOBS"
echo "===================="

# è¯»å–æœåŠ¡å™¨åˆ—è¡¨å¹¶å¹¶å‘æ‰§è¡Œ
while read -r server; do
    [[ -z "$server" || "$server" =~ ^# ]] && continue
    
    # æ§åˆ¶å¹¶å‘æ•°é‡
    while [ $(jobs -r | wc -l) -ge $MAX_JOBS ]; do
        sleep 0.1
    done
    
    # åå°æ‰§è¡Œ
    execute_ssh "$server" "$COMMAND" &
    
done < "$SERVER_FILE"

# ç­‰å¾…æ‰€æœ‰åå°ä»»åŠ¡å®Œæˆ
wait
echo "ğŸ‰ æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆ!"
```

### 6.3 ä¸“ä¸šæ‰¹é‡å·¥å…·pssh


**ğŸ”§ å®‰è£…psshå·¥å…·**
```bash
# CentOS/RHEL
sudo yum install pssh

# Ubuntu/Debian  
sudo apt-get install pssh

# æˆ–è€…ä½¿ç”¨pipå®‰è£…
pip install pssh
```

**ğŸ’¡ psshåŸºç¡€ç”¨æ³•**
```bash
# åŸºæœ¬è¯­æ³•
pssh -h hosts.txt -l username "command"

# å‚æ•°è¯´æ˜ï¼š
# -h hosts.txt  : ä¸»æœºåˆ—è¡¨æ–‡ä»¶
# -l username   : ç™»å½•ç”¨æˆ·å
# -A           : è¯¢é—®å¯†ç ï¼ˆäº¤äº’å¼ï¼‰
# -i           : æ˜¾ç¤ºæ¯å°ä¸»æœºçš„è¾“å‡º
# -P           : å®æ—¶æ˜¾ç¤ºè¾“å‡º
```

**ğŸ¯ psshå®æˆ˜ç¤ºä¾‹**
```bash
# 1. åˆ›å»ºä¸»æœºåˆ—è¡¨æ–‡ä»¶
cat > hosts.txt << EOF
192.168.1.10
192.168.1.11
192.168.1.12
EOF

# 2. æ‰¹é‡æ‰§è¡Œå‘½ä»¤
pssh -h hosts.txt -l root -i "uptime"

# 3. å¹¶å‘æ§åˆ¶
pssh -h hosts.txt -l root -i -p 10 "free -m"
# -p 10: æœ€å¤§å¹¶å‘10ä¸ªè¿æ¥

# 4. è¶…æ—¶æ§åˆ¶
pssh -h hosts.txt -l root -i -t 30 "yum update -y"
# -t 30: è¶…æ—¶30ç§’
```

### 6.4 é«˜çº§æ‰¹é‡æ‰§è¡Œ


**ğŸ¯ å¸¦é”™è¯¯å¤„ç†çš„æ‰¹é‡æ‰§è¡Œ**
```bash
#!/bin/bash
# é«˜çº§æ‰¹é‡SSHæ‰§è¡Œè„šæœ¬

# é…ç½®
SERVERS_FILE="servers.txt"
COMMAND="$1"
TIMEOUT=30
MAX_PARALLEL=5
LOG_DIR="logs/$(date +%Y%m%d_%H%M%S)"

# æ£€æŸ¥å‚æ•°
if [ -z "$COMMAND" ]; then
    echo "ç”¨æ³•: $0 'è¦æ‰§è¡Œçš„å‘½ä»¤'"
    echo "ç¤ºä¾‹: $0 'df -h'"
    exit 1
fi

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p "$LOG_DIR"

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'  
YELLOW='\033[1;33m'
NC='\033[0m'

# æ‰§è¡Œå‡½æ•°
execute_command() {
    local server=$1
    local cmd=$2
    local logfile="$LOG_DIR/${server//\//_}.log"
    
    echo "$(date): å¼€å§‹æ‰§è¡Œ $server" >> "$logfile"
    
    # æ‰§è¡ŒSSHå‘½ä»¤
    timeout $TIMEOUT ssh -o ConnectTimeout=10 -o StrictHostKeyChecking=no \
        "$server" "$cmd" > "$logfile.out" 2> "$logfile.err"
    local status=$?
    
    # è®°å½•ç»“æœ
    echo "$(date): æ‰§è¡Œå®Œæˆï¼ŒçŠ¶æ€ç : $status" >> "$logfile"
    
    # è¾“å‡ºç»“æœ
    if [ $status -eq 0 ]; then
        echo -e "${GREEN}âœ… [$server] æˆåŠŸ${NC}"
        if [ -s "$logfile.out" ]; then
            echo "è¾“å‡º:"
            cat "$logfile.out" | sed 's/^/    /'
        fi
    else
        echo -e "${RED}âŒ [$server] å¤±è´¥ (çŠ¶æ€ç : $status)${NC}"
        if [ -s "$logfile.err" ]; then
            echo "é”™è¯¯ä¿¡æ¯:"
            cat "$logfile.err" | sed 's/^/    /'
        fi
    fi
    echo "---"
    
    return $status
}

# ä¸»æ‰§è¡Œé€»è¾‘
echo -e "${YELLOW}ğŸš€ æ‰¹é‡SSHå‘½ä»¤æ‰§è¡Œ${NC}"
echo "å‘½ä»¤: $COMMAND"
echo "è¶…æ—¶: ${TIMEOUT}ç§’"
echo "æœ€å¤§å¹¶å‘: $MAX_PARALLEL"
echo "æ—¥å¿—ç›®å½•: $LOG_DIR"
echo "=================="

SUCCESS=0
FAILED=0

while read -r server; do
    # è·³è¿‡æ³¨é‡Šå’Œç©ºè¡Œ
    [[ -z "$server" || "$server" =~ ^# ]] && continue
    
    # æ§åˆ¶å¹¶å‘æ•°
    while [ $(jobs -r | wc -l) -ge $MAX_PARALLEL ]; do
        sleep 0.1
    done
    
    # åå°æ‰§è¡Œ
    {
        execute_command "$server" "$COMMAND"
        if [ $? -eq 0 ]; then
            echo "SUCCESS:$server" >> "$LOG_DIR/summary.log"
        else
            echo "FAILED:$server" >> "$LOG_DIR/summary.log"
        fi
    } &
    
done < "$SERVERS_FILE"

# ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
wait

# ç»Ÿè®¡ç»“æœ
if [ -f "$LOG_DIR/summary.log" ]; then
    SUCCESS=$(grep -c "SUCCESS:" "$LOG_DIR/summary.log" 2>/dev/null || echo 0)
    FAILED=$(grep -c "FAILED:" "$LOG_DIR/summary.log" 2>/dev/null || echo 0)
fi

echo "=================="
echo -e "${GREEN}âœ… æˆåŠŸ: $SUCCESS${NC}"
echo -e "${RED}âŒ å¤±è´¥: $FAILED${NC}"
echo "ğŸ“‹ è¯¦ç»†æ—¥å¿—: $LOG_DIR"
```

---

## 7. ğŸŒ SSHéš§é“ä¸ç«¯å£è½¬å‘


### 7.1 SSHéš§é“åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯SSHéš§é“**
SSHéš§é“å°±åƒåœ¨ç½‘ç»œä¸­æŒ–äº†ä¸€æ¡**åŠ å¯†çš„åœ°ä¸‹é€šé“**ï¼Œè®©ä½ å¯ä»¥å®‰å…¨åœ°è®¿é—®è¿œç¨‹ç½‘ç»œä¸­çš„æœåŠ¡ï¼Œæˆ–è€…è®©è¿œç¨‹æœåŠ¡å™¨è®¿é—®ä½ æœ¬åœ°çš„æœåŠ¡ã€‚

```
æ­£å¸¸ç½‘ç»œè®¿é—®ï¼š
ä½ çš„ç”µè„‘ â”€â”€â”€â”€ç›´æ¥è¿æ¥â”€â”€â”€â”€â†’ ç›®æ ‡æœåŠ¡ (å¯èƒ½è¢«é˜²ç«å¢™é˜»æŒ¡)

SSHéš§é“è®¿é—®ï¼š  
ä½ çš„ç”µè„‘ â•â•SSHåŠ å¯†éš§é“â•â•â†’ SSHæœåŠ¡å™¨ â”€â”€â”€â”€â†’ ç›®æ ‡æœåŠ¡
         (å®‰å…¨é€šé“)                  (å†…ç½‘è®¿é—®)
```

**ğŸ”¸ SSHéš§é“çš„ä¸‰ç§ç±»å‹**
1. **æœ¬åœ°ç«¯å£è½¬å‘**ï¼šæŠŠè¿œç¨‹æœåŠ¡"æ‹‰"åˆ°æœ¬åœ°
2. **è¿œç¨‹ç«¯å£è½¬å‘**ï¼šæŠŠæœ¬åœ°æœåŠ¡"æ¨"åˆ°è¿œç¨‹  
3. **åŠ¨æ€ç«¯å£è½¬å‘**ï¼šåˆ›å»ºSOCKSä»£ç†

### 7.2 æœ¬åœ°ç«¯å£è½¬å‘ï¼ˆLocal Port Forwardingï¼‰


**ğŸ’¡ æœ¬åœ°è½¬å‘åŸç†**
æŠŠè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æŸä¸ªç«¯å£ï¼Œæ˜ å°„åˆ°ä½ æœ¬åœ°ç”µè„‘çš„æŸä¸ªç«¯å£ä¸Šã€‚

```
è®¿é—®æµç¨‹ï¼š
æµè§ˆå™¨è®¿é—® localhost:8080 
    â†“
SSHéš§é“è½¬å‘åˆ° remote-server:80
    â†“  
è¿œç¨‹æœåŠ¡å™¨çš„80ç«¯å£ï¼ˆæ¯”å¦‚ç½‘ç«™ï¼‰
```

**ğŸ”§ åŸºç¡€ç”¨æ³•**
```bash
# åŸºæœ¬è¯­æ³•
ssh -L æœ¬åœ°ç«¯å£:ç›®æ ‡ä¸»æœº:ç›®æ ‡ç«¯å£ SSHæœåŠ¡å™¨

# å®ä¾‹ï¼šè®¿é—®è¿œç¨‹MySQLæ•°æ®åº“
ssh -L 3306:localhost:3306 user@database-server
# ç°åœ¨è®¿é—® localhost:3306 å°±ç­‰äºè®¿é—®è¿œç¨‹æœåŠ¡å™¨çš„MySQL

# å®ä¾‹ï¼šè®¿é—®è¿œç¨‹WebæœåŠ¡
ssh -L 8080:localhost:80 user@web-server  
# ç°åœ¨è®¿é—® http://localhost:8080 å°±ç­‰äºè®¿é—®è¿œç¨‹çš„ç½‘ç«™
```

**ğŸ¯ å®æˆ˜åœºæ™¯ç¤ºä¾‹**
```bash
# åœºæ™¯1ï¼šè®¿é—®è¿œç¨‹å†…ç½‘çš„Webç®¡ç†ç•Œé¢
ssh -L 9090:192.168.1.100:8080 user@jump-server
# è®¿é—® http://localhost:9090 å°±èƒ½è®¿é—®å†…ç½‘çš„ç®¡ç†ç•Œé¢

# åœºæ™¯2ï¼šè¿æ¥è¿œç¨‹å†…ç½‘çš„æ•°æ®åº“
ssh -L 5432:db.internal:5432 user@gateway-server
# ç”¨æ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥ localhost:5432

# åœºæ™¯3ï¼šè®¿é—®å¤šä¸ªè¿œç¨‹æœåŠ¡
ssh -L 3306:db1:3306 -L 6379:redis1:6379 user@server
# åŒæ—¶æ˜ å°„MySQLå’ŒRedisæœåŠ¡
```

### 7.3 è¿œç¨‹ç«¯å£è½¬å‘ï¼ˆRemote Port Forwardingï¼‰


**ğŸ’¡ è¿œç¨‹è½¬å‘åŸç†**
æŠŠä½ æœ¬åœ°çš„æŸä¸ªæœåŠ¡ï¼Œæ˜ å°„åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æŸä¸ªç«¯å£ä¸Šï¼Œè®©è¿œç¨‹ç”¨æˆ·å¯ä»¥è®¿é—®ä½ æœ¬åœ°çš„æœåŠ¡ã€‚

```
è®¿é—®æµç¨‹ï¼š
è¿œç¨‹ç”¨æˆ·è®¿é—® remote-server:8080
    â†“
SSHéš§é“è½¬å‘åˆ° localhost:80  
    â†“
ä½ æœ¬åœ°ç”µè„‘çš„80ç«¯å£æœåŠ¡
```

**ğŸ”§ åŸºç¡€ç”¨æ³•**
```bash
# åŸºæœ¬è¯­æ³•  
ssh -R è¿œç¨‹ç«¯å£:æœ¬åœ°ä¸»æœº:æœ¬åœ°ç«¯å£ SSHæœåŠ¡å™¨

# å®ä¾‹ï¼šè®©è¿œç¨‹ç”¨æˆ·è®¿é—®ä½ çš„æœ¬åœ°ç½‘ç«™
ssh -R 8080:localhost:3000 user@public-server
# è¿œç¨‹ç”¨æˆ·è®¿é—® public-server:8080 å°±èƒ½çœ‹åˆ°ä½ æœ¬åœ°3000ç«¯å£çš„ç½‘ç«™

# å®ä¾‹ï¼šè¿œç¨‹è°ƒè¯•æœ¬åœ°åº”ç”¨
ssh -R 9000:localhost:9000 user@dev-server  
# è¿œç¨‹å¯ä»¥é€šè¿‡ dev-server:9000 è°ƒè¯•ä½ æœ¬åœ°çš„åº”ç”¨
```

### 7.4 åŠ¨æ€ç«¯å£è½¬å‘ï¼ˆSOCKSä»£ç†ï¼‰


**ğŸ”¸ åŠ¨æ€è½¬å‘åŸç†**  
åˆ›å»ºä¸€ä¸ªSOCKSä»£ç†ï¼Œè®©ä½ çš„æ‰€æœ‰ç½‘ç»œæµé‡éƒ½é€šè¿‡SSHæœåŠ¡å™¨ä¸­è½¬ã€‚

```bash
# åˆ›å»ºSOCKSä»£ç†
ssh -D 1080 user@proxy-server

# ç„¶åé…ç½®æµè§ˆå™¨ä½¿ç”¨ localhost:1080 ä½œä¸ºSOCKSä»£ç†
# ä½ çš„æ‰€æœ‰ç½‘ç»œè®¿é—®éƒ½ä¼šé€šè¿‡ proxy-server ä¸­è½¬
```

**ğŸ¯ SOCKSä»£ç†åº”ç”¨åœºæ™¯**
```bash
# åœºæ™¯1ï¼šé€šè¿‡è·³æ¿æœºè®¿é—®å†…ç½‘  
ssh -D 1080 user@jumpserver
# é…ç½®æµè§ˆå™¨ä»£ç†ä¸º localhost:1080
# ç°åœ¨å¯ä»¥è®¿é—®è·³æ¿æœºèƒ½è®¿é—®çš„æ‰€æœ‰å†…ç½‘èµ„æº

# åœºæ™¯2ï¼šç§‘å­¦ä¸Šç½‘ï¼ˆåˆæ³•ç”¨é€”ï¼‰
ssh -D 1080 user@overseas-server
# é€šè¿‡æµ·å¤–æœåŠ¡å™¨ä¸­è½¬ç½‘ç»œæµé‡
```

### 7.5 SSHéš§é“é«˜çº§åº”ç”¨


**ğŸ”§ æŒä¹…åŒ–éš§é“è„šæœ¬**
```bash
#!/bin/bash
# SSHéš§é“æŒä¹…åŒ–è„šæœ¬

# é…ç½®
SSH_SERVER="user@tunnel-server"
LOCAL_PORT=8080
REMOTE_HOST="internal-web"
REMOTE_PORT=80
PIDFILE="/tmp/ssh_tunnel.pid"

start_tunnel() {
    echo "ğŸš€ å¯åŠ¨SSHéš§é“..."
    
    # æ£€æŸ¥æ˜¯å¦å·²ç»è¿è¡Œ
    if [ -f "$PIDFILE" ] && kill -0 $(cat "$PIDFILE") 2>/dev/null; then
        echo "âŒ SSHéš§é“å·²åœ¨è¿è¡Œ (PID: $(cat $PIDFILE))"
        return 1
    fi
    
    # å¯åŠ¨SSHéš§é“
    ssh -f -N -L $LOCAL_PORT:$REMOTE_HOST:$REMOTE_PORT $SSH_SERVER
    
    # è®°å½•PID
    ssh_pid=$(ps aux | grep "ssh.*$LOCAL_PORT:$REMOTE_HOST:$REMOTE_PORT" | grep -v grep | awk '{print $2}')
    echo $ssh_pid > "$PIDFILE"
    
    echo "âœ… SSHéš§é“å·²å¯åŠ¨ (PID: $ssh_pid)"
    echo "ç°åœ¨å¯ä»¥è®¿é—®: http://localhost:$LOCAL_PORT"
}

stop_tunnel() {
    echo "ğŸ›‘ åœæ­¢SSHéš§é“..."
    
    if [ -f "$PIDFILE" ]; then
        pid=$(cat "$PIDFILE")
        if kill -0 $pid 2>/dev/null; then
            kill $pid
            rm -f "$PIDFILE"
            echo "âœ… SSHéš§é“å·²åœæ­¢"
        else
            echo "âŒ SSHéš§é“è¿›ç¨‹ä¸å­˜åœ¨"
            rm -f "$PIDFILE"
        fi
    else
        echo "âŒ æ²¡æœ‰æ‰¾åˆ°è¿è¡Œçš„SSHéš§é“"
    fi
}

status_tunnel() {
    if [ -f "$PIDFILE" ] && kill -0 $(cat "$PIDFILE") 2>/dev/null; then
        echo "âœ… SSHéš§é“æ­£åœ¨è¿è¡Œ (PID: $(cat $PIDFILE))"
        echo "è®¿é—®åœ°å€: http://localhost:$LOCAL_PORT"
    else
        echo "âŒ SSHéš§é“æœªè¿è¡Œ"
    fi
}

case "$1" in
    start)
        start_tunnel
        ;;
    stop)
        stop_tunnel
        ;;
    status)
        status_tunnel
        ;;
    restart)
        stop_tunnel
        sleep 2
        start_tunnel
        ;;
    *)
        echo "ç”¨æ³•: $0 {start|stop|status|restart}"
        exit 1
        ;;
esac
```

**ğŸ¯ å¤šéš§é“ç®¡ç†è„šæœ¬**
```bash
#!/bin/bash
# å¤šSSHéš§é“ç®¡ç†è„šæœ¬

CONFIG_FILE="tunnels.conf"

# åˆ›å»ºç¤ºä¾‹é…ç½®æ–‡ä»¶
if [ ! -f "$CONFIG_FILE" ]; then
    cat > "$CONFIG_FILE" << 'EOF'
# SSHéš§é“é…ç½®æ–‡ä»¶
# æ ¼å¼: éš§é“åç§°|ç±»å‹|æœ¬åœ°ç«¯å£|è¿œç¨‹ä¸»æœº|è¿œç¨‹ç«¯å£|SSHæœåŠ¡å™¨
web-admin|L|8080|192.168.1.100|80|user@jumpserver
database|L|3306|db.internal|3306|user@gateway
redis|L|6379|cache.internal|6379|user@gateway  
socks-proxy|D|1080|||user@proxy-server
EOF
    echo "å·²åˆ›å»ºé…ç½®æ–‡ä»¶: $CONFIG_FILE"
    echo "è¯·ç¼–è¾‘é…ç½®æ–‡ä»¶åé‡æ–°è¿è¡Œ"
    exit 0
fi

start_all_tunnels() {
    echo "ğŸš€ å¯åŠ¨æ‰€æœ‰SSHéš§é“..."
    
    while IFS='|' read -r name type local_port remote_host remote_port ssh_server; do
        [[ "$name" =~ ^#.*$ ]] && continue
        [[ -z "$name" ]] && continue
        
        echo "å¯åŠ¨éš§é“: $name"
        
        case "$type" in
            L)
                ssh -f -N -L $local_port:$remote_host:$remote_port $ssh_server
                ;;
            R)  
                ssh -f -N -R $local_port:$remote_host:$remote_port $ssh_server
                ;;
            D)
                ssh -f -N -D $local_port $ssh_server
                ;;
        esac
        
        if [ $? -eq 0 ]; then
            echo "âœ… $name å¯åŠ¨æˆåŠŸ"
        else
            echo "âŒ $name å¯åŠ¨å¤±è´¥"
        fi
        
    done < "$CONFIG_FILE"
}

stop_all_tunnels() {
    echo "ğŸ›‘ åœæ­¢æ‰€æœ‰SSHéš§é“..."
    
    # æŸ¥æ‰¾å¹¶åœæ­¢æ‰€æœ‰SSHéš§é“è¿›ç¨‹
    pkill -f "ssh.*-[LRD]"
    
    echo "âœ… æ‰€æœ‰SSHéš§é“å·²åœæ­¢"
}

list_tunnels() {
    echo "ğŸ“‹ å½“å‰SSHéš§é“çŠ¶æ€:"
    echo "===================="
    
    ps aux | grep "ssh.*-[LRD]" | grep -v grep | while read line; do
        pid=$(echo $line | awk '{print $2}')
        cmd=$(echo $line | awk '{for(i=11;i<=NF;i++) printf "%s ", $i; print ""}')
        echo "PID: $pid | $cmd"
    done
}

case "$1" in
    start)
        start_all_tunnels
        ;;
    stop)
        stop_all_tunnels
        ;;
    list)
        list_tunnels
        ;;
    restart)
        stop_all_tunnels
        sleep 2
        start_all_tunnels
        ;;
    *)
        echo "ç”¨æ³•: $0 {start|stop|list|restart}"
        exit 1
        ;;
esac
```

---

## 8. ğŸ›ï¸ è¿æ¥æ§åˆ¶ä¸ä¼˜åŒ–


### 8.1 å¹¶å‘è¿æ¥æ•°æ§åˆ¶


**ğŸ”¸ ä¸ºä»€ä¹ˆè¦æ§åˆ¶å¹¶å‘è¿æ¥æ•°**
å½“ä½ åŒæ—¶å‘å¾ˆå¤šæœåŠ¡å™¨å‘èµ·SSHè¿æ¥æ—¶ï¼Œå¦‚æœä¸åŠ æ§åˆ¶ï¼Œå¯èƒ½ä¼šï¼š
- **å‹å®ç›®æ ‡æœåŠ¡å™¨**ï¼šæœåŠ¡å™¨åŒæ—¶å¤„ç†å¤ªå¤šè¿æ¥ä¼šå¡æ­»
- **è€—å°½æœ¬åœ°èµ„æº**ï¼šä½ çš„ç”µè„‘ä¹Ÿä¼šå› ä¸ºå¤ªå¤šè¿æ¥è€Œå˜æ…¢  
- **è§¦å‘å®‰å…¨ç­–ç•¥**ï¼šå¯èƒ½è¢«è¯¯è®¤ä¸ºæ˜¯æ”»å‡»è¡Œä¸º

```
æ— æ§åˆ¶çš„è¿æ¥ï¼š               æœ‰æ§åˆ¶çš„è¿æ¥ï¼š
åŒæ—¶è¿æ¥100å°æœåŠ¡å™¨          æœ€å¤šåŒæ—¶è¿æ¥10å°
    â†“                           â†“
æœåŠ¡å™¨å‹åŠ›å·¨å¤§               æœåŠ¡å™¨å‹åŠ›é€‚ä¸­
ç½‘ç»œæ‹¥å µ                    ç½‘ç»œæµç•…æœ‰åº
å¯èƒ½è¢«å±è”½                  æ­£å¸¸ç¨³å®šè¿è¡Œ
```

**ğŸ¯ å¹¶å‘æ§åˆ¶ç­–ç•¥**
```bash
#!/bin/bash
# å¹¶å‘è¿æ¥æ§åˆ¶ç¤ºä¾‹

MAX_JOBS=5  # æœ€å¤§åŒæ—¶è¿æ¥æ•°
servers=("server1" "server2" "server3" "server4" "server5" "server6")

for server in "${servers[@]}"; do
    # ç­‰å¾…ç›´åˆ°å¹¶å‘æ•°å°äºæœ€å¤§å€¼
    while [ $(jobs -r | wc -l) -ge $MAX_JOBS ]; do
        sleep 0.1
    done
    
    # åå°æ‰§è¡ŒSSHå‘½ä»¤
    {
        echo "è¿æ¥ $server..."
        ssh "$server" 'uptime'
    } &
done

# ç­‰å¾…æ‰€æœ‰åå°ä»»åŠ¡å®Œæˆ
wait
```

### 8.2 è¿æ¥è¶…æ—¶ä¸é‡è¯•æœºåˆ¶


**ğŸ”¸ è¶…æ—¶è®¾ç½®çš„é‡è¦æ€§**
ç½‘ç»œç¯å¢ƒå¤æ‚ï¼ŒæœåŠ¡å™¨å¯èƒ½å› ä¸ºå„ç§åŸå› æ— å“åº”ã€‚è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´å¯ä»¥é¿å…**é•¿æ—¶é—´ç­‰å¾…æ— å“åº”çš„è¿æ¥**ã€‚

**ğŸ”§ SSHè¶…æ—¶é…ç½®**
```bash
# ~/.ssh/configä¸­çš„è¶…æ—¶è®¾ç½®
Host *
    ConnectTimeout 10        # è¿æ¥è¶…æ—¶10ç§’
    ServerAliveInterval 60   # æ¯60ç§’å‘é€ä¿æ´»åŒ…
    ServerAliveCountMax 3    # æœ€å¤š3æ¬¡æ— å“åº”å°±æ–­å¼€
```

**ğŸ’¡ è¶…æ—¶å‚æ•°è¯¦è§£**
```
ConnectTimeout: å»ºç«‹è¿æ¥çš„æœ€å¤§ç­‰å¾…æ—¶é—´
- å¤ªçŸ­ï¼šæ­£å¸¸çš„æ…¢ç½‘ç»œä¹Ÿä¼šè¶…æ—¶
- å¤ªé•¿ï¼šæ— å“åº”æœåŠ¡å™¨ä¼šæµªè´¹æ—¶é—´
- æ¨èï¼š10-30ç§’

ServerAliveInterval: ä¿æ´»æ£€æµ‹é—´éš”  
- é˜²æ­¢é•¿æ—¶é—´è¿æ¥è¢«ä¸­é—´è®¾å¤‡æ–­å¼€
- æ¨èï¼š60ç§’

ServerAliveCountMax: ä¿æ´»å¤±è´¥æœ€å¤§æ¬¡æ•°
- è¿ç»­å‡ æ¬¡ä¿æ´»å¤±è´¥å°±æ–­å¼€è¿æ¥
- æ¨èï¼š3æ¬¡
```

**ğŸ¯ å¸¦é‡è¯•çš„è¿æ¥è„šæœ¬**
```bash
#!/bin/bash
# å¸¦è¶…æ—¶å’Œé‡è¯•çš„SSHè¿æ¥è„šæœ¬

connect_with_retry() {
    local server=$1
    local command=$2  
    local max_retries=3
    local timeout=10
    local retry_delay=5
    
    for ((i=1; i<=max_retries; i++)); do
        echo "ğŸ”„ å°è¯•è¿æ¥ $server (ç¬¬ $i/$max_retries æ¬¡)"
        
        # ä½¿ç”¨timeoutå‘½ä»¤é™åˆ¶æ€»æ‰§è¡Œæ—¶é—´
        if timeout $timeout ssh -o ConnectTimeout=10 -o StrictHostKeyChecking=no \
           "$server" "$command"; then
            echo "âœ… $server è¿æ¥æˆåŠŸ"
            return 0
        else
            echo "âŒ $server è¿æ¥å¤±è´¥"
            
            if [ $i -lt $max_retries ]; then
                echo "â³ ${retry_delay}ç§’åé‡è¯•..."
                sleep $retry_delay
            fi
        fi
    done
    
    echo "ğŸš« $server è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè·³è¿‡"
    return 1
}

# ä½¿ç”¨ç¤ºä¾‹
servers=("server1" "server2" "server3")

for server in "${servers[@]}"; do
    connect_with_retry "$server" "hostname && uptime"
done
```

### 8.3 è¿æ¥æ€§èƒ½ä¼˜åŒ–


**ğŸš€ SSHæ€§èƒ½ä¼˜åŒ–é…ç½®**
```bash
# ~/.ssh/config æ€§èƒ½ä¼˜åŒ–é…ç½®
Host *
    # è¿æ¥å¤ç”¨ï¼ˆä¹‹å‰å·²ä»‹ç»ï¼‰
    ControlMaster auto
    ControlPath ~/.ssh/sockets/%r@%h:%p
    ControlPersist 600
    
    # å‹ç¼©ä¼ è¾“ï¼ˆé€‚åˆæ…¢ç½‘ç»œï¼‰
    Compression yes
    
    # TCPä¿æ´»
    TCPKeepAlive yes
    
    # è·³è¿‡å·²çŸ¥ä¸»æœºæ£€æŸ¥ï¼ˆå†…ç½‘ç¯å¢ƒï¼‰
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    
    # å‡å°‘æ—¥å¿—è¾“å‡º
    LogLevel QUIET
    
    # ç¦ç”¨X11è½¬å‘ï¼ˆä¸éœ€è¦æ—¶ï¼‰
    ForwardX11 no
    
    # ç¦ç”¨Agentè½¬å‘ï¼ˆæé«˜å®‰å…¨æ€§ï¼‰
    ForwardAgent no
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”æµ‹è¯•è„šæœ¬**
```bash
#!/bin/bash
# SSHæ€§èƒ½æµ‹è¯•è„šæœ¬

SERVER="test-server"
TEST_COMMAND="echo 'performance test'"

echo "ğŸ” SSHæ€§èƒ½æµ‹è¯•"
echo "=================="

# æµ‹è¯•1ï¼šæ™®é€šè¿æ¥
echo "ğŸ“ æµ‹è¯•1: æ™®é€šè¿æ¥"
time_normal=$(time ssh "$SERVER" "$TEST_COMMAND" 2>&1 | grep real | awk '{print $2}')
echo "æ™®é€šè¿æ¥è€—æ—¶: $time_normal"

# æµ‹è¯•2ï¼šå¯ç”¨å‹ç¼©
echo "ğŸ“ æµ‹è¯•2: å¯ç”¨å‹ç¼©" 
time_compressed=$(time ssh -C "$SERVER" "$TEST_COMMAND" 2>&1 | grep real | awk '{print $2}')
echo "å‹ç¼©è¿æ¥è€—æ—¶: $time_compressed"

# æµ‹è¯•3ï¼šä½¿ç”¨è¿æ¥å¤ç”¨ï¼ˆéœ€è¦å…ˆå»ºç«‹ä¸»è¿æ¥ï¼‰
echo "ğŸ“ æµ‹è¯•3: è¿æ¥å¤ç”¨"
ssh -f -N "$SERVER"  # å»ºç«‹ä¸»è¿æ¥
time_multiplexed=$(time ssh "$SERVER" "$TEST_COMMAND" 2>&1 | grep real | awk '{print $2}')
echo "å¤ç”¨è¿æ¥è€—æ—¶: $time_multiplexed"

# æ¸…ç†ä¸»è¿æ¥
ssh -O stop "$SERVER" 2>/dev/null

echo "=================="
echo "ğŸ“Š æ€§èƒ½å¯¹æ¯”ç»“æœ:"
echo "æ™®é€šè¿æ¥: $time_normal"
echo "å‹ç¼©è¿æ¥: $time_compressed"  
echo "å¤ç”¨è¿æ¥: $time_multiplexed"
```

### 8.4 é”™è¯¯å¤„ç†ä¸æ—¥å¿—è®°å½•


**ğŸ”§ å®Œå–„çš„é”™è¯¯å¤„ç†è„šæœ¬**
```bash
#!/bin/bash
# å®Œå–„çš„SSHæ‰¹é‡è¿æ¥è„šæœ¬

# é…ç½®
SERVERS_FILE="servers.txt"
LOG_DIR="logs/$(date +%Y%m%d_%H%M%S)"
MAX_PARALLEL=5
TIMEOUT=30

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p "$LOG_DIR"

# æ—¥å¿—å‡½æ•°
log() {
    local level=$1
    local message=$2
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$timestamp] [$level] $message" | tee -a "$LOG_DIR/main.log"
}

# SSHæ‰§è¡Œå‡½æ•°
execute_ssh_command() {
    local server=$1
    local command=$2
    local server_log="$LOG_DIR/${server//\//_}.log"
    
    log "INFO" "å¼€å§‹å¤„ç†æœåŠ¡å™¨: $server"
    
    # è¿æ¥æµ‹è¯•
    if ! timeout 5 ssh -o ConnectTimeout=5 -o BatchMode=yes \
         "$server" "echo 'connection test'" > /dev/null 2>&1; then
        log "ERROR" "$server è¿æ¥æµ‹è¯•å¤±è´¥"
        echo "$server:CONNECT_FAILED" >> "$LOG_DIR/failed.log"
        return 1
    fi
    
    # æ‰§è¡Œå‘½ä»¤
    {
        echo "=== SSHå‘½ä»¤æ‰§è¡Œæ—¥å¿— ==="
        echo "æœåŠ¡å™¨: $server"
        echo "å‘½ä»¤: $command"
        echo "å¼€å§‹æ—¶é—´: $(date)"
        echo "========================"
        
        timeout $TIMEOUT ssh -o ConnectTimeout=10 \
            -o StrictHostKeyChecking=no \
            "$server" "$command"
        
        echo "ç»“æŸæ—¶é—´: $(date)"
        echo "é€€å‡ºçŠ¶æ€: $?"
        
    } > "$server_log" 2>&1
    
    local exit_code=$?
    
    if [ $exit_code -eq 0 ]; then
        log "SUCCESS" "$server æ‰§è¡ŒæˆåŠŸ"
        echo "$server:SUCCESS" >> "$LOG_DIR/success.log"
    elif [ $exit_code -eq 124 ]; then
        log "ERROR" "$server æ‰§è¡Œè¶…æ—¶"  
        echo "$server:TIMEOUT" >> "$LOG_DIR/failed.log"
    else
        log "ERROR" "$server æ‰§è¡Œå¤±è´¥ (é€€å‡ºç : $exit_code)"
        echo "$server:FAILED:$exit_code" >> "$LOG_DIR/failed.log" 
    fi
    
    return $exit_code
}

# ä¸»æ‰§è¡Œé€»è¾‘
main() {
    local command="$1"
    
    if [ -z "$command" ]; then
        echo "ç”¨æ³•: $0 'è¦æ‰§è¡Œçš„å‘½ä»¤'"
        exit 1
    fi
    
    if [ ! -f "$SERVERS_FILE" ]; then
        echo "æœåŠ¡å™¨åˆ—è¡¨æ–‡ä»¶ä¸å­˜åœ¨: $SERVERS_FILE"
        exit 1
    fi
    
    log "INFO" "å¼€å§‹æ‰¹é‡SSHæ“ä½œ"
    log "INFO" "å‘½ä»¤: $command"
    log "INFO" "æœ€å¤§å¹¶å‘: $MAX_PARALLEL"
    log "INFO" "è¶…æ—¶è®¾ç½®: ${TIMEOUT}ç§’"
    
    # å¹¶å‘æ‰§è¡Œ
    while read -r server; do
        [[ -z "$server" || "$server" =~ ^# ]] && continue
        
        # æ§åˆ¶å¹¶å‘æ•°
        while [ $(jobs -r | wc -l) -ge $MAX_PARALLEL ]; do
            sleep 0.1
        done
        
        # åå°æ‰§è¡Œ
        execute_ssh_command "$server" "$command" &
        
    done < "$SERVERS_FILE"
    
    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    wait
    
    # ç»Ÿè®¡ç»“æœ
    local success_count=$(wc -l < "$LOG_DIR/success.log" 2>/dev/null || echo 0)
    local failed_count=$(wc -l < "$LOG_DIR/failed.log" 2>/dev/null || echo 0)
    
    log "INFO" "æ‰¹é‡æ“ä½œå®Œæˆ"
    log "INFO" "æˆåŠŸ: $success_count å°"
    log "INFO" "å¤±è´¥: $failed_count å°"
    log "INFO" "è¯¦ç»†æ—¥å¿—: $LOG_DIR"
    
    # æ˜¾ç¤ºå¤±è´¥åˆ—è¡¨
    if [ $failed_count -gt 0 ]; then
        echo ""
        echo "âŒ å¤±è´¥çš„æœåŠ¡å™¨:"
        cat "$LOG_DIR/failed.log" | while IFS=':' read -r server status; do
            echo "  $server ($status)"
        done
    fi
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$1"
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> ğŸ’¡ **SSHæ‰¹é‡ç®¡ç†ç²¾é«“**ï¼š**ä¸€æ¬¡é…ç½®ï¼Œç»ˆèº«å—ç›Šï¼›æ‰¹é‡æ“ä½œï¼Œäº‹åŠåŠŸå€**

**ğŸ”¸ SSHå¯†é’¥è®¤è¯**
```
æ ¸å¿ƒåŸç†ï¼šå…¬é’¥ç§é’¥é…å¯¹ï¼Œå…å¯†ç è‡ªåŠ¨è®¤è¯
å®ç”¨ä»·å€¼ï¼šæ‰¹é‡æ“ä½œçš„åŸºçŸ³ï¼Œå®‰å…¨æ€§è¿œè¶…å¯†ç 
æ“ä½œè¦ç‚¹ï¼šç§é’¥ä¸¥æ ¼ä¿å¯†(600æƒé™)ï¼Œå…¬é’¥å¯ä»¥å…¬å¼€åˆ†å‘
è®°å¿†è¦è¯€ï¼šç§é’¥æ˜¯ä½ çš„èº«ä»½è¯ï¼Œå…¬é’¥æ˜¯ä½ çš„åç‰‡
```

**ğŸ”¸ ssh-copy-idå·¥å…·**
```
å·¥å…·æœ¬è´¨ï¼šè‡ªåŠ¨åŒ–å…¬é’¥åˆ†å‘ï¼Œæ¯”æ‰‹åŠ¨å¤åˆ¶æ›´å®‰å…¨å¯é 
ä½¿ç”¨åœºæ™¯ï¼šåˆå§‹åŒ–æœåŠ¡å™¨è®¤è¯ï¼Œæ‰¹é‡éƒ¨ç½²å¿…å¤‡å·¥å…·
æ ¸å¿ƒä¼˜åŠ¿ï¼šè‡ªåŠ¨å¤„ç†æƒé™ã€æ ¼å¼ã€ç›®å½•åˆ›å»ºç­‰ç»†èŠ‚
å®æˆ˜æŠ€å·§ï¼šé…åˆè„šæœ¬å®ç°æ‰¹é‡åˆ†å‘ï¼Œæé«˜éƒ¨ç½²æ•ˆç‡
```

**ğŸ”¸ SSHé…ç½®ç®¡ç†**
```
é…ç½®æ–‡ä»¶ï¼š~/.ssh/configï¼ŒSSHå®¢æˆ·ç«¯çš„"é€šè®¯å½•"
æ ¸å¿ƒä½œç”¨ï¼šæœåŠ¡å™¨åˆ«åã€é»˜è®¤å‚æ•°ã€ç»Ÿä¸€ç®¡ç†
å®ç”¨ä»·å€¼ï¼šå¤æ‚è¿æ¥å‚æ•°å˜æˆç®€å•åˆ«å
ä¼˜åŒ–è¦ç‚¹ï¼šé€šé…ç¬¦é…ç½®ã€åˆ†ç¯å¢ƒç®¡ç†ã€è¿æ¥å¤ç”¨
```

**ğŸ”¸ è¿æ¥å¤ç”¨æŠ€æœ¯**
```
æŠ€æœ¯åŸç†ï¼šä¸€æ¡ä¸»é€šé“ï¼Œå¤šä¸ªè¿æ¥å…±äº«
æ€§èƒ½æå‡ï¼šåç»­è¿æ¥ä»3ç§’å˜æˆ0.1ç§’
åº”ç”¨åœºæ™¯ï¼šé¢‘ç¹SSHæ“ä½œã€æ‰¹é‡å‘½ä»¤æ‰§è¡Œ
é…ç½®è¦ç‚¹ï¼šControlMaster + ControlPath + ControlPersist
```

### 9.2 æ‰¹é‡æ“ä½œæ ¸å¿ƒç­–ç•¥


**ğŸ¯ å¹¶å‘æ§åˆ¶åŸåˆ™**
```
å¹³è¡¡ç­–ç•¥ï¼šæ—¢è¦æé«˜æ•ˆç‡ï¼Œåˆè¦é¿å…å‹å®æœåŠ¡å™¨
æ¨èå¹¶å‘æ•°ï¼š
â€¢ å†…ç½‘ç¯å¢ƒï¼š10-20ä¸ªå¹¶å‘
â€¢ å…¬ç½‘ç¯å¢ƒï¼š5-10ä¸ªå¹¶å‘  
â€¢ è€æ—§æœåŠ¡å™¨ï¼š3-5ä¸ªå¹¶å‘

æ§åˆ¶æ–¹æ³•ï¼š
â€¢ Shellè„šæœ¬ï¼šä½¿ç”¨jobså‘½ä»¤æ§åˆ¶åå°ä»»åŠ¡æ•°
â€¢ ä¸“ä¸šå·¥å…·ï¼špssh -på‚æ•°æ§åˆ¶å¹¶å‘
â€¢ è¶…æ—¶æœºåˆ¶ï¼šé¿å…æ— å“åº”è¿æ¥å ç”¨èµ„æº
```

**ğŸ”§ é”™è¯¯å¤„ç†æœºåˆ¶**
```
ä¸‰å±‚é˜²æŠ¤ï¼š
1. è¿æ¥æµ‹è¯•ï¼šå…ˆæµ‹è¯•è¿é€šæ€§å†æ‰§è¡Œå‘½ä»¤
2. è¶…æ—¶æ§åˆ¶ï¼šé¿å…é•¿æ—¶é—´ç­‰å¾…æ— å“åº”æœåŠ¡å™¨
3. é‡è¯•æœºåˆ¶ï¼šç½‘ç»œæŠ–åŠ¨æ—¶è‡ªåŠ¨é‡è¯•

æ—¥å¿—è®°å½•ï¼š
â€¢ è¯¦ç»†è®°å½•æ¯ä¸ªæœåŠ¡å™¨çš„æ‰§è¡Œæƒ…å†µ
â€¢ åŒºåˆ†æˆåŠŸã€å¤±è´¥ã€è¶…æ—¶ç­‰ä¸åŒçŠ¶æ€
â€¢ ä¾¿äºäº‹ååˆ†æå’Œæ•…éšœæ’é™¤
```

### 9.3 SSHéš§é“æŠ€æœ¯è¦ç‚¹


**ğŸŒ éš§é“ç±»å‹é€‰æ‹©**
```
æœ¬åœ°ç«¯å£è½¬å‘(-L)ï¼š
â€¢ ç”¨é€”ï¼šè®¿é—®è¿œç¨‹å†…ç½‘æœåŠ¡
â€¢ åœºæ™¯ï¼šæ•°æ®åº“è¿æ¥ã€Webç®¡ç†ç•Œé¢
â€¢ è®°å¿†ï¼šæŠŠè¿œç¨‹æœåŠ¡"æ‹‰"åˆ°æœ¬åœ°

è¿œç¨‹ç«¯å£è½¬å‘(-R)ï¼š  
â€¢ ç”¨é€”ï¼šè®©è¿œç¨‹è®¿é—®æœ¬åœ°æœåŠ¡
â€¢ åœºæ™¯ï¼šè¿œç¨‹è°ƒè¯•ã€å†…ç½‘ç©¿é€
â€¢ è®°å¿†ï¼šæŠŠæœ¬åœ°æœåŠ¡"æ¨"åˆ°è¿œç¨‹

åŠ¨æ€ç«¯å£è½¬å‘(-D)ï¼š
â€¢ ç”¨é€”ï¼šåˆ›å»ºSOCKSä»£ç†
â€¢ åœºæ™¯ï¼šé€šè¿‡è·³æ¿æœºè®¿é—®å†…ç½‘
â€¢ è®°å¿†ï¼šä¸‡èƒ½ä»£ç†ï¼Œä»€ä¹ˆéƒ½èƒ½è½¬å‘
```

**ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
éš§é“å®‰å…¨ï¼š
â€¢ éš§é“æœ¬èº«æ˜¯åŠ å¯†çš„ï¼Œä½†è¦æ³¨æ„ä¸¤ç«¯çš„å®‰å…¨
â€¢ ä¸è¦åœ¨å…¬ç½‘ä¸Šå¼€æ”¾ä¸å¿…è¦çš„ç«¯å£è½¬å‘
â€¢ å®šæœŸæ£€æŸ¥å’Œæ¸…ç†æ— ç”¨çš„éš§é“è¿æ¥

æƒé™æ§åˆ¶ï¼š
â€¢ SSHå¯†é’¥æ–‡ä»¶æƒé™å¿…é¡»æ­£ç¡®(600)
â€¢ ä¸è¦ä½¿ç”¨weakå¯†ç çŸ­è¯­æˆ–ç©ºå¯†ç çŸ­è¯­
â€¢ å®šæœŸè½®æ¢SSHå¯†é’¥ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒ
```

### 9.4 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š åº”ç”¨åœºæ™¯å¯¹ç…§è¡¨**

| åœºæ™¯ç±»å‹ | **æ¨èå·¥å…·** | **é…ç½®è¦ç‚¹** | **æ³¨æ„äº‹é¡¹** |
|---------|------------|-------------|-------------|
| **æ—¥å¸¸è¿ç»´** | `SSHé…ç½®æ–‡ä»¶` | `æœåŠ¡å™¨åˆ«åï¼Œè¿æ¥å¤ç”¨` | `æƒé™ç®¡ç†ï¼Œå®šæœŸæ¸…ç†` |
| **æ‰¹é‡éƒ¨ç½²** | `ssh-copy-id + è„šæœ¬` | `å¹¶å‘æ§åˆ¶ï¼Œé”™è¯¯å¤„ç†` | `æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯` |
| **ç›‘æ§æ£€æŸ¥** | `pssh` | `è¶…æ—¶è®¾ç½®ï¼Œæ—¥å¿—è®°å½•` | `é¿å…å½±å“ä¸šåŠ¡` |
| **å†…ç½‘è®¿é—®** | `SSHéš§é“` | `ç«¯å£è§„åˆ’ï¼Œå®‰å…¨ç­–ç•¥` | `åŠæ—¶æ¸…ç†æ— ç”¨éš§é“` |
| **åº”æ€¥å¤„ç†** | `è¿æ¥å¤ç”¨ + æ‰¹é‡å‘½ä»¤` | `å¿«é€Ÿå“åº”ï¼Œå‡†ç¡®æ‰§è¡Œ` | `æ“ä½œå‰äºŒæ¬¡ç¡®è®¤` |

**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```
ç½‘ç»œä¼˜åŒ–ï¼š
â€¢ å†…ç½‘ç¯å¢ƒï¼šå…³é—­å‹ç¼©ï¼Œå¯ç”¨è¿æ¥å¤ç”¨
â€¢ æ…¢ç½‘ç»œï¼šå¯ç”¨å‹ç¼©ï¼Œå¢åŠ è¶…æ—¶æ—¶é—´
â€¢ ä¸ç¨³å®šç½‘ç»œï¼šå¢åŠ é‡è¯•æ¬¡æ•°ï¼Œç¼©çŸ­ä¿æ´»é—´éš”

èµ„æºä¼˜åŒ–ï¼š
â€¢ åˆç†æ§åˆ¶å¹¶å‘æ•°ï¼Œé¿å…èµ„æºè€—å°½
â€¢ åŠæ—¶æ¸…ç†æ— ç”¨çš„SSHè¿æ¥å’Œéš§é“
â€¢ ä½¿ç”¨è¿æ¥å¤ç”¨å‡å°‘è¿æ¥å»ºç«‹å¼€é”€
```

### 9.5 æ•…éšœæ’é™¤æŒ‡å—


**ğŸ”§ å¸¸è§é—®é¢˜å¿«é€Ÿè¯Šæ–­**

**é—®é¢˜1ï¼šå…¬é’¥è®¤è¯å¤±è´¥**
```bash
# è¯Šæ–­æ­¥éª¤ï¼š
1. æ£€æŸ¥ç§é’¥æƒé™ï¼šls -la ~/.ssh/id_rsa
2. æ£€æŸ¥å…¬é’¥å†…å®¹ï¼šcat ~/.ssh/id_rsa.pub
3. æ£€æŸ¥æœåŠ¡å™¨æˆæƒæ–‡ä»¶ï¼šcat ~/.ssh/authorized_keys
4. æ£€æŸ¥SSHæ—¥å¿—ï¼štail -f /var/log/auth.log

# è§£å†³æ–¹æ³•ï¼š
chmod 600 ~/.ssh/id_rsa
ssh-copy-id -f user@server  # å¼ºåˆ¶é‡æ–°åˆ†å‘
```

**é—®é¢˜2ï¼šè¿æ¥è¶…æ—¶æˆ–æ‹’ç»**
```bash
# è¯Šæ–­æ­¥éª¤ï¼š
1. ç½‘ç»œè¿é€šæ€§ï¼šping target-server
2. ç«¯å£å¼€æ”¾æ€§ï¼štelnet target-server 22
3. SSHæœåŠ¡çŠ¶æ€ï¼šsystemctl status sshd
4. é˜²ç«å¢™è§„åˆ™ï¼šiptables -L

# è§£å†³æ–¹æ³•ï¼š
ssh -v user@server  # è¯¦ç»†æ¨¡å¼è¯Šæ–­
ssh -o ConnectTimeout=60 user@server  # å¢åŠ è¶…æ—¶æ—¶é—´
```

**é—®é¢˜3ï¼šæ‰¹é‡æ“ä½œéƒ¨åˆ†å¤±è´¥**
```bash
# è¯Šæ–­æ­¥éª¤ï¼š
1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—æ‰¾å‡ºå¤±è´¥åŸå› 
2. å¯¹å¤±è´¥çš„æœåŠ¡å™¨å•ç‹¬æµ‹è¯•
3. æ£€æŸ¥ç½‘ç»œå’ŒæœåŠ¡å™¨çŠ¶æ€
4. éªŒè¯å‘½ä»¤åœ¨ç›®æ ‡ç¯å¢ƒçš„å…¼å®¹æ€§

# è§£å†³æ–¹æ³•ï¼š
# é‡æ–°æ‰§è¡Œå¤±è´¥çš„æœåŠ¡å™¨
grep FAILED logs/failed.log | cut -d: -f1 > retry_servers.txt
# ç„¶åé’ˆå¯¹retry_servers.txté‡æ–°æ‰§è¡Œ
```

### 9.6 æœ€ä½³å®è·µæ€»ç»“


**ğŸ† SSHæ‰¹é‡ç®¡ç†é»„é‡‘æ³•åˆ™**

```
1. ğŸ”‘ å®‰å…¨ç¬¬ä¸€
   â€¢ SSHå¯†é’¥æƒé™ä¸¥æ ¼æ§åˆ¶
   â€¢ å®šæœŸè½®æ¢å¯†é’¥
   â€¢ ç”Ÿäº§ç¯å¢ƒç¦ç”¨å¯†ç è®¤è¯

2. âš¡ æ•ˆç‡è‡³ä¸Š  
   â€¢ ä½¿ç”¨SSHé…ç½®æ–‡ä»¶ç®¡ç†æœåŠ¡å™¨
   â€¢ å¯ç”¨è¿æ¥å¤ç”¨æå‡æ€§èƒ½
   â€¢ åˆç†æ§åˆ¶å¹¶å‘æ•°é‡

3. ğŸ›¡ï¸ ç¨³å®šå¯é 
   â€¢ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
   â€¢ è¯¦ç»†çš„æ—¥å¿—è®°å½•
   â€¢ æµ‹è¯•ç¯å¢ƒéªŒè¯åå†ç”¨äºç”Ÿäº§

4. ğŸ“š ä¾¿äºç»´æŠ¤
   â€¢ æ ‡å‡†åŒ–çš„é…ç½®å’Œè„šæœ¬
   â€¢ æ¸…æ™°çš„æ–‡æ¡£å’Œæ³¨é‡Š
   â€¢ å®šæœŸæ¸…ç†æ— ç”¨è¿æ¥å’Œé…ç½®
```

**ğŸ¯ è¿›é˜¶å­¦ä¹ è·¯å¾„**
```
å…¥é—¨é˜¶æ®µï¼šSSHåŸºç¡€ â†’ å¯†é’¥è®¤è¯ â†’ é…ç½®æ–‡ä»¶
è¿›é˜¶é˜¶æ®µï¼šè¿æ¥å¤ç”¨ â†’ æ‰¹é‡æ“ä½œ â†’ éš§é“æŠ€æœ¯  
é«˜çº§é˜¶æ®µï¼šè‡ªåŠ¨åŒ–è„šæœ¬ â†’ æ€§èƒ½ä¼˜åŒ– â†’ å®‰å…¨åŠ å›º
ä¸“å®¶é˜¶æ®µï¼šé›†æˆè‡ªåŠ¨åŒ–å·¥å…· â†’ å¤§è§„æ¨¡é›†ç¾¤ç®¡ç†
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- SSHæ‰¹é‡ç®¡ç†ï¼Œå¯†é’¥è®¤è¯æ˜¯æ ¹åŸº
- é…ç½®æ–‡ä»¶å·§ç®¡ç†ï¼Œåˆ«åå¤ç”¨ææ•ˆç‡
- æ‰¹é‡æ“ä½œæ§å¹¶å‘ï¼Œé”™è¯¯å¤„ç†è¦å®Œå¤‡
- éš§é“æŠ€æœ¯å¾ˆç¥å¥‡ï¼Œå†…ç½‘è®¿é—®æ— éšœç¢
- å®‰å…¨æ€§èƒ½ä¸¤æ‰‹æŠ“ï¼Œç¨³å®šé«˜æ•ˆèµ°å¤©ä¸‹

---

> ğŸ‰ **æ­å–œï¼** ä½ å·²ç»æŒæ¡äº†SSHæ‰¹é‡è¿æ¥ç®¡ç†çš„æ ¸å¿ƒæŠ€æœ¯ã€‚è¿™äº›æŠ€èƒ½å°†æå¤§æå‡ä½ çš„è¿ç»´æ•ˆç‡ï¼Œè®©åŸæœ¬éœ€è¦é‡å¤æ“ä½œçš„å·¥ä½œå˜å¾—è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–ã€‚è®°ä½ï¼š**å·¥å…·æ˜¯ä¸ºäº†è®©å·¥ä½œæ›´ç®€å•ï¼Œè€Œä¸æ˜¯æ›´å¤æ‚**ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¦æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ³•ï¼Œé€æ­¥æ„å»ºè‡ªå·±çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ç®±ï¼