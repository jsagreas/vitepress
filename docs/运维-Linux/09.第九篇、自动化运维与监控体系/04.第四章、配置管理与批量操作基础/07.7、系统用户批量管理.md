---
title: 7ã€ç³»ç»Ÿç”¨æˆ·æ‰¹é‡ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ç”¨æˆ·æ‰¹é‡ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-ç”¨æˆ·æ‰¹é‡ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [æ‰¹é‡ç”¨æˆ·åˆ›å»ºè„šæœ¬](#2-æ‰¹é‡ç”¨æˆ·åˆ›å»ºè„šæœ¬)
3. [ç”¨æˆ·å¯†ç æ‰¹é‡è®¾ç½®](#3-ç”¨æˆ·å¯†ç æ‰¹é‡è®¾ç½®)
4. [SSHå¯†é’¥æ‰¹é‡éƒ¨ç½²](#4-SSHå¯†é’¥æ‰¹é‡éƒ¨ç½²)
5. [ç”¨æˆ·ç»„æ‰¹é‡ç®¡ç†](#5-ç”¨æˆ·ç»„æ‰¹é‡ç®¡ç†)
6. [sudoæƒé™æ‰¹é‡é…ç½®](#6-sudoæƒé™æ‰¹é‡é…ç½®)
7. [ç”¨æˆ·å®¶ç›®å½•æ ‡å‡†åŒ–](#7-ç”¨æˆ·å®¶ç›®å½•æ ‡å‡†åŒ–)
8. [è´¦æˆ·è¿‡æœŸç­–ç•¥ç®¡ç†](#8-è´¦æˆ·è¿‡æœŸç­–ç•¥ç®¡ç†)
9. [ç”¨æˆ·ä¿¡æ¯æ‰¹é‡æŸ¥è¯¢](#9-ç”¨æˆ·ä¿¡æ¯æ‰¹é‡æŸ¥è¯¢)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ‘¥ ç”¨æˆ·æ‰¹é‡ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç”¨æˆ·æ‰¹é‡ç®¡ç†


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
ç”¨æˆ·æ‰¹é‡ç®¡ç†ï¼šé€šè¿‡è„šæœ¬å’Œè‡ªåŠ¨åŒ–å·¥å…·ï¼Œä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªç”¨æˆ·è´¦æˆ·çš„åˆ›å»ºã€é…ç½®å’Œç®¡ç†
ç›®æ ‡ï¼šæé«˜è¿ç»´æ•ˆç‡ï¼Œç¡®ä¿ç”¨æˆ·é…ç½®çš„ä¸€è‡´æ€§å’Œæ ‡å‡†åŒ–
åº”ç”¨åœºæ™¯ï¼šæ–°å‘˜å·¥å…¥èŒã€é¡¹ç›®ç»„å»ºã€ç³»ç»Ÿè¿ç§»ç­‰
```

**ğŸ’¡ é€šä¿—ç†è§£**
æƒ³è±¡ä½ æ˜¯å­¦æ ¡çš„æ•™åŠ¡ç®¡ç†å‘˜ï¼š
- **æ‰‹å·¥æ–¹å¼**ï¼šä¸€ä¸ªä¸ªå­¦ç”Ÿå½•å…¥ç³»ç»Ÿï¼Œè´¹æ—¶è´¹åŠ›è¿˜å®¹æ˜“å‡ºé”™
- **æ‰¹é‡ç®¡ç†**ï¼šå¯¼å…¥å­¦ç”Ÿåå•ï¼Œè‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰è´¦æˆ·å’Œæƒé™

### 1.2 æ‰¹é‡ç®¡ç†çš„æ ¸å¿ƒä¼˜åŠ¿


**ğŸ¯ ä¸»è¦ä»·å€¼**
- **âš¡ æ•ˆç‡æå‡**ï¼šå‡ åˆ†é’Ÿå®Œæˆå‡ ç™¾ä¸ªç”¨æˆ·çš„åˆ›å»º
- **ğŸ“ æ ‡å‡†ä¸€è‡´**ï¼šæ‰€æœ‰ç”¨æˆ·é…ç½®å®Œå…¨ç»Ÿä¸€
- **ğŸ”’ å®‰å…¨å¯æ§**ï¼šç»Ÿä¸€çš„æƒé™å’Œå®‰å…¨ç­–ç•¥
- **ğŸ“ å¯è¿½æº¯æ€§**ï¼šå®Œæ•´çš„æ“ä½œæ—¥å¿—å’Œè®°å½•

### 1.3 ç”¨æˆ·ç®¡ç†æ ¸å¿ƒæ–‡ä»¶


**ğŸ“ ç³»ç»Ÿå…³é”®æ–‡ä»¶**
```
/etc/passwd     â† ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
/etc/shadow     â† ç”¨æˆ·å¯†ç ä¿¡æ¯  
/etc/group      â† ç”¨æˆ·ç»„ä¿¡æ¯
/etc/gshadow    â† ç”¨æˆ·ç»„å¯†ç ä¿¡æ¯
/etc/sudoers    â† sudoæƒé™é…ç½®
/home/          â† ç”¨æˆ·å®¶ç›®å½•
```

**ğŸ” æ–‡ä»¶æ ¼å¼è§£è¯»**
```
/etc/passwdæ ¼å¼ï¼š
ç”¨æˆ·å:å¯†ç å ä½ç¬¦:UID:GID:æè¿°ä¿¡æ¯:å®¶ç›®å½•:ç™»å½•Shell

ç¤ºä¾‹ï¼š
john:x:1001:1001:John Smith:/home/john:/bin/bash
```

---

## 2. ğŸ—ï¸ æ‰¹é‡ç”¨æˆ·åˆ›å»ºè„šæœ¬


### 2.1 ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶å‡†å¤‡


**ğŸ“‹ æ ‡å‡†ç”¨æˆ·ä¿¡æ¯æ ¼å¼**
```
# users.txt - ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶
# æ ¼å¼ï¼šç”¨æˆ·å,çœŸå®å§“å,éƒ¨é—¨,èŒä½
alice,Alice Wang,ç ”å‘éƒ¨,å‰ç«¯å·¥ç¨‹å¸ˆ
bob,Bob Zhang,è¿ç»´éƒ¨,ç³»ç»Ÿç®¡ç†å‘˜
carol,Carol Li,äº§å“éƒ¨,äº§å“ç»ç†
dave,Dave Liu,æµ‹è¯•éƒ¨,æµ‹è¯•å·¥ç¨‹å¸ˆ
```

### 2.2 åŸºç¡€æ‰¹é‡åˆ›å»ºè„šæœ¬


**ğŸ› ï¸ ç”¨æˆ·åˆ›å»ºè„šæœ¬å®ç°**
```bash
#!/bin/bash
# create_users.sh - æ‰¹é‡ç”¨æˆ·åˆ›å»ºè„šæœ¬

USER_FILE="users.txt"
LOG_FILE="user_creation.log"
DEFAULT_SHELL="/bin/bash"
DEFAULT_GROUP="employees"

# æ—¥å¿—è®°å½•å‡½æ•°
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# åˆ›å»ºç”¨æˆ·å‡½æ•°
create_user() {
    local username="$1"
    local fullname="$2"
    local department="$3"
    local position="$4"
    
    # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
    if id "$username" >/dev/null 2>&1; then
        log_message "âš ï¸ ç”¨æˆ· $username å·²å­˜åœ¨ï¼Œè·³è¿‡"
        return 1
    fi
    
    # åˆ›å»ºç”¨æˆ·
    if useradd -m -s "$DEFAULT_SHELL" -c "$fullname,$department,$position" "$username"; then
        log_message "âœ… æˆåŠŸåˆ›å»ºç”¨æˆ·: $username ($fullname)"
        return 0
    else
        log_message "âŒ åˆ›å»ºç”¨æˆ·å¤±è´¥: $username"
        return 1
    fi
}

# ä¸»å¤„ç†æµç¨‹
main() {
    log_message "ğŸš€ å¼€å§‹æ‰¹é‡åˆ›å»ºç”¨æˆ·..."
    
    local success_count=0
    local fail_count=0
    
    while IFS=',' read -r username fullname department position; do
        # è·³è¿‡æ³¨é‡Šè¡Œ
        [[ "$username" =~ ^#.*$ ]] && continue
        
        if create_user "$username" "$fullname" "$department" "$position"; then
            ((success_count++))
        else
            ((fail_count++))
        fi
    done < "$USER_FILE"
    
    log_message "ğŸ“Š åˆ›å»ºå®Œæˆ: æˆåŠŸ$success_countä¸ªï¼Œå¤±è´¥$fail_countä¸ª"
}

# æ‰§è¡Œä¸»å‡½æ•°
main
```

### 2.3 é«˜çº§åˆ›å»ºé€‰é¡¹


**âš™ï¸ ç”¨æˆ·åˆ›å»ºå‚æ•°é…ç½®**
```bash
# é«˜çº§ç”¨æˆ·åˆ›å»ºå‡½æ•°
create_user_advanced() {
    local username="$1"
    local uid_start="$2"
    local group_name="$3"
    local home_base="$4"
    
    # è‡ªåŠ¨åˆ†é…UID
    local next_uid=$(get_next_available_uid "$uid_start")
    
    # åˆ›å»ºç”¨æˆ·ç»„ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
    if ! getent group "$group_name" >/dev/null; then
        groupadd "$group_name"
    fi
    
    # åˆ›å»ºç”¨æˆ·å¹¶æŒ‡å®šå‚æ•°
    useradd \
        --uid "$next_uid" \
        --gid "$group_name" \
        --home-dir "$home_base/$username" \
        --create-home \
        --shell "$DEFAULT_SHELL" \
        --comment "$fullname" \
        "$username"
}

# è·å–ä¸‹ä¸€ä¸ªå¯ç”¨UID
get_next_available_uid() {
    local start_uid="$1"
    local uid="$start_uid"
    
    while getent passwd "$uid" >/dev/null; do
        ((uid++))
    done
    
    echo "$uid"
}
```

---

## 3. ğŸ” ç”¨æˆ·å¯†ç æ‰¹é‡è®¾ç½®


### 3.1 å¯†ç ç­–ç•¥è®¾è®¡


**ğŸ›¡ï¸ å®‰å…¨å¯†ç ç”Ÿæˆç­–ç•¥**
- **é•¿åº¦è¦æ±‚**ï¼šè‡³å°‘12ä½å­—ç¬¦
- **å¤æ‚åº¦è¦æ±‚**ï¼šå¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šå­—ç¬¦
- **ä¸´æ—¶å¯†ç **ï¼šé¦–æ¬¡ç™»å½•å¼ºåˆ¶ä¿®æ”¹
- **è¿‡æœŸç­–ç•¥**ï¼šå®šæœŸæ›´æ–°å¯†ç 

### 3.2 éšæœºå¯†ç æ‰¹é‡ç”Ÿæˆ


**ğŸ² å¯†ç ç”Ÿæˆè„šæœ¬**
```bash
#!/bin/bash
# password_manager.sh - å¯†ç æ‰¹é‡ç®¡ç†

PASSWD_FILE="user_passwords.txt"
PASSWD_LENGTH=12

# ç”Ÿæˆå®‰å…¨éšæœºå¯†ç 
generate_password() {
    local length="${1:-$PASSWD_LENGTH}"
    
    # ä½¿ç”¨å¤šç§å­—ç¬¦ç»„åˆç”Ÿæˆå¯†ç 
    tr -dc 'A-Za-z0-9!@#$%^&*' < /dev/urandom | head -c "$length"
}

# æ‰¹é‡è®¾ç½®å¯†ç 
set_batch_passwords() {
    echo "ğŸ” å¼€å§‹æ‰¹é‡è®¾ç½®ç”¨æˆ·å¯†ç ..."
    
    # æ¸…ç©ºå¯†ç æ–‡ä»¶
    > "$PASSWD_FILE"
    echo "# ç”¨æˆ·å¯†ç æ¸…å• - $(date)" >> "$PASSWD_FILE"
    echo "# ç”¨æˆ·å:ä¸´æ—¶å¯†ç " >> "$PASSWD_FILE"
    
    while read -r username; do
        # è·³è¿‡ç³»ç»Ÿç”¨æˆ·ï¼ˆUID < 1000ï¼‰
        local uid=$(id -u "$username" 2>/dev/null)
        [[ -z "$uid" || "$uid" -lt 1000 ]] && continue
        
        # ç”Ÿæˆéšæœºå¯†ç 
        local password=$(generate_password)
        
        # è®¾ç½®å¯†ç 
        if echo "$username:$password" | chpasswd; then
            echo "$username:$password" >> "$PASSWD_FILE"
            echo "âœ… $username å¯†ç å·²è®¾ç½®"
            
            # å¼ºåˆ¶é¦–æ¬¡ç™»å½•ä¿®æ”¹å¯†ç 
            chage -d 0 "$username"
        else
            echo "âŒ $username å¯†ç è®¾ç½®å¤±è´¥"
        fi
    done < <(cut -d: -f1 /etc/passwd | grep -v '^#')
    
    echo "ğŸ“‹ å¯†ç æ¸…å•å·²ä¿å­˜åˆ°: $PASSWD_FILE"
}
```

### 3.3 å¯†ç å®‰å…¨ç­–ç•¥é…ç½®


**ğŸ”’ å¯†ç ç­–ç•¥å®æ–½**
```bash
# é…ç½®å¯†ç è¿‡æœŸç­–ç•¥
setup_password_policy() {
    local username="$1"
    
    # è®¾ç½®å¯†ç ç­–ç•¥
    chage -M 90 "$username"    # æœ€å¤§90å¤©æœ‰æ•ˆæœŸ
    chage -m 7 "$username"     # æœ€å°7å¤©ä¿®æ”¹é—´éš”
    chage -W 7 "$username"     # è¿‡æœŸå‰7å¤©è­¦å‘Š
    chage -I 30 "$username"    # è¿‡æœŸå30å¤©ç¦ç”¨è´¦æˆ·
    
    echo "ğŸ”’ å·²ä¸ºç”¨æˆ· $username è®¾ç½®å¯†ç ç­–ç•¥"
}

# æ‰¹é‡åº”ç”¨å¯†ç ç­–ç•¥
apply_password_policies() {
    echo "ğŸ“‹ æ‰¹é‡åº”ç”¨å¯†ç ç­–ç•¥..."
    
    while IFS=':' read -r username _ uid _; do
        # åªå¤„ç†æ™®é€šç”¨æˆ·
        [[ "$uid" -ge 1000 && "$uid" -lt 65534 ]] || continue
        
        setup_password_policy "$username"
    done < /etc/passwd
}
```

---

## 4. ğŸ”‘ SSHå¯†é’¥æ‰¹é‡éƒ¨ç½²


### 4.1 SSHå¯†é’¥ç®¡ç†æ¦‚å¿µ


**ğŸ”‘ SSHå¯†é’¥è®¤è¯ä¼˜åŠ¿**
- **ğŸš€ æ— å¯†ç ç™»å½•**ï¼šæé«˜ç™»å½•æ•ˆç‡
- **ğŸ” å®‰å…¨æ€§æ›´é«˜**ï¼šå¯†é’¥æ¯”å¯†ç æ›´éš¾ç ´è§£
- **ğŸ“Š å®¡è®¡å‹å¥½**ï¼šæ¯ä¸ªå¯†é’¥å¯ä»¥è¿½è¸ªä½¿ç”¨è®°å½•
- **ğŸ¯ ç²¾ç¡®æ§åˆ¶**ï¼šå¯ä»¥é™åˆ¶å¯†é’¥çš„ä½¿ç”¨èŒƒå›´

### 4.2 å¯†é’¥ç”Ÿæˆä¸åˆ†å‘è„šæœ¬


**ğŸ› ï¸ SSHå¯†é’¥æ‰¹é‡éƒ¨ç½²å®ç°**
```bash
#!/bin/bash
# ssh_key_deploy.sh - SSHå¯†é’¥æ‰¹é‡éƒ¨ç½²

KEY_TYPE="rsa"
KEY_BITS="2048"
ADMIN_PUBKEY="admin_rsa.pub"

# ä¸ºç”¨æˆ·ç”ŸæˆSSHå¯†é’¥å¯¹
generate_user_keys() {
    local username="$1"
    local user_home="/home/$username"
    local ssh_dir="$user_home/.ssh"
    
    # åˆ›å»º.sshç›®å½•
    mkdir -p "$ssh_dir"
    chmod 700 "$ssh_dir"
    
    # ç”Ÿæˆå¯†é’¥å¯¹
    ssh-keygen -t "$KEY_TYPE" -b "$KEY_BITS" -f "$ssh_dir/id_$KEY_TYPE" -N "" -C "$username@$(hostname)"
    
    # è®¾ç½®æ–‡ä»¶æƒé™
    chmod 600 "$ssh_dir/id_$KEY_TYPE"
    chmod 644 "$ssh_dir/id_$KEY_TYPE.pub"
    
    # è®¾ç½®æ‰€æœ‰è€…
    chown -R "$username:$username" "$ssh_dir"
    
    echo "ğŸ”‘ å·²ä¸ºç”¨æˆ· $username ç”ŸæˆSSHå¯†é’¥"
}

# éƒ¨ç½²ç®¡ç†å‘˜å…¬é’¥åˆ°ç”¨æˆ·è´¦æˆ·
deploy_admin_key() {
    local username="$1"
    local user_home="/home/$username"
    local authorized_keys="$user_home/.ssh/authorized_keys"
    
    # ç¡®ä¿.sshç›®å½•å­˜åœ¨
    mkdir -p "$user_home/.ssh"
    
    # æ·»åŠ ç®¡ç†å‘˜å…¬é’¥
    if [[ -f "$ADMIN_PUBKEY" ]]; then
        cat "$ADMIN_PUBKEY" >> "$authorized_keys"
        chmod 600 "$authorized_keys"
        chown "$username:$username" "$authorized_keys"
        echo "âœ… å·²éƒ¨ç½²ç®¡ç†å‘˜å¯†é’¥åˆ° $username"
    else
        echo "âš ï¸ ç®¡ç†å‘˜å…¬é’¥æ–‡ä»¶ä¸å­˜åœ¨: $ADMIN_PUBKEY"
    fi
}

# æ‰¹é‡å¤„ç†ç”¨æˆ·SSHå¯†é’¥
batch_deploy_keys() {
    echo "ğŸš€ å¼€å§‹æ‰¹é‡éƒ¨ç½²SSHå¯†é’¥..."
    
    while read -r username; do
        # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ä¸”ä¸ºæ™®é€šç”¨æˆ·
        local uid=$(id -u "$username" 2>/dev/null)
        if [[ -n "$uid" && "$uid" -ge 1000 && "$uid" -lt 65534 ]]; then
            generate_user_keys "$username"
            deploy_admin_key "$username"
        fi
    done < <(cut -d: -f1 /etc/passwd)
}
```

### 4.3 SSHé…ç½®ä¼˜åŒ–


**âš™ï¸ SSHå®‰å…¨é…ç½®**
```bash
# ä¼˜åŒ–SSHæœåŠ¡é…ç½®
optimize_ssh_config() {
    local sshd_config="/etc/ssh/sshd_config"
    local backup_config="/etc/ssh/sshd_config.backup.$(date +%Y%m%d)"
    
    # å¤‡ä»½åŸé…ç½®
    cp "$sshd_config" "$backup_config"
    
    # åº”ç”¨å®‰å…¨é…ç½®
    cat >> "$sshd_config" << 'EOF'

# æ‰¹é‡ç”¨æˆ·ç®¡ç†å®‰å…¨é…ç½®
Protocol 2
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM yes
X11Forwarding no
MaxAuthTries 3
ClientAliveInterval 300
ClientAliveCountMax 2
EOF
    
    # é‡å¯SSHæœåŠ¡
    systemctl restart sshd
    echo "ğŸ”§ SSHé…ç½®å·²ä¼˜åŒ–"
}
```

---

## 5. ğŸ‘¥ ç”¨æˆ·ç»„æ‰¹é‡ç®¡ç†


### 5.1 ç”¨æˆ·ç»„è®¾è®¡åŸåˆ™


**ğŸ“Š ç»„ç»‡æ¶æ„æ˜ å°„**
```
éƒ¨é—¨ç»„ç»‡ç»“æ„ï¼š
    å…¬å¸(company)
    â”œâ”€â”€ ç ”å‘éƒ¨(dev)
    â”‚   â”œâ”€â”€ å‰ç«¯ç»„(frontend)  
    â”‚   â””â”€â”€ åç«¯ç»„(backend)
    â”œâ”€â”€ è¿ç»´éƒ¨(ops)
    â”‚   â”œâ”€â”€ ç³»ç»Ÿç»„(sysadmin)
    â”‚   â””â”€â”€ ç½‘ç»œç»„(network)
    â””â”€â”€ äº§å“éƒ¨(product)
        â”œâ”€â”€ è®¾è®¡ç»„(design)
        â””â”€â”€ æµ‹è¯•ç»„(qa)
```

### 5.2 æ‰¹é‡ç»„åˆ›å»ºè„šæœ¬


**ğŸ—ï¸ ç”¨æˆ·ç»„æ‰¹é‡åˆ›å»º**
```bash
#!/bin/bash
# group_manager.sh - ç”¨æˆ·ç»„æ‰¹é‡ç®¡ç†

GROUPS_FILE="groups_config.txt"

# ç”¨æˆ·ç»„é…ç½®æ–‡ä»¶æ ¼å¼ç¤ºä¾‹
create_groups_config() {
    cat > "$GROUPS_FILE" << 'EOF'
# ç”¨æˆ·ç»„é…ç½®æ–‡ä»¶
# æ ¼å¼ï¼šç»„å,GID,æè¿°
company,2000,å…¬å¸æ ¹ç»„
dev,2001,ç ”å‘éƒ¨é—¨
ops,2002,è¿ç»´éƒ¨é—¨  
product,2003,äº§å“éƒ¨é—¨
frontend,2101,å‰ç«¯å¼€å‘ç»„
backend,2102,åç«¯å¼€å‘ç»„
sysadmin,2201,ç³»ç»Ÿç®¡ç†ç»„
network,2202,ç½‘ç»œç®¡ç†ç»„
design,2301,UIè®¾è®¡ç»„
qa,2302,è´¨é‡ä¿è¯ç»„
EOF
}

# æ‰¹é‡åˆ›å»ºç”¨æˆ·ç»„
create_groups() {
    echo "ğŸ‘¥ å¼€å§‹æ‰¹é‡åˆ›å»ºç”¨æˆ·ç»„..."
    
    while IFS=',' read -r group_name gid description; do
        # è·³è¿‡æ³¨é‡Šè¡Œ
        [[ "$group_name" =~ ^#.*$ ]] && continue
        
        # æ£€æŸ¥ç»„æ˜¯å¦å·²å­˜åœ¨
        if getent group "$group_name" >/dev/null 2>&1; then
            echo "âš ï¸ ç”¨æˆ·ç»„ $group_name å·²å­˜åœ¨ï¼Œè·³è¿‡"
            continue
        fi
        
        # åˆ›å»ºç”¨æˆ·ç»„
        if groupadd -g "$gid" "$group_name"; then
            echo "âœ… åˆ›å»ºç”¨æˆ·ç»„: $group_name (GID: $gid) - $description"
        else
            echo "âŒ åˆ›å»ºç”¨æˆ·ç»„å¤±è´¥: $group_name"
        fi
    done < "$GROUPS_FILE"
}
```

### 5.3 ç”¨æˆ·ç»„æˆå‘˜ç®¡ç†


**ğŸ‘¤ æ‰¹é‡ç”¨æˆ·ç»„åˆ†é…**
```bash
# æ ¹æ®éƒ¨é—¨åˆ†é…ç”¨æˆ·åˆ°ç»„
assign_users_to_groups() {
    echo "ğŸ“ æ‰¹é‡åˆ†é…ç”¨æˆ·åˆ°ç»„..."
    
    # è¯»å–ç”¨æˆ·ä¿¡æ¯å¹¶åˆ†é…ç»„
    while IFS=',' read -r username fullname department position; do
        [[ "$username" =~ ^#.*$ ]] && continue
        
        # æ ¹æ®éƒ¨é—¨åˆ†é…ä¸»ç»„
        case "$department" in
            "ç ”å‘éƒ¨")
                usermod -g dev "$username"
                # æ ¹æ®èŒä½æ·»åŠ é™„åŠ ç»„
                case "$position" in
                    *"å‰ç«¯"*) usermod -a -G frontend "$username" ;;
                    *"åç«¯"*) usermod -a -G backend "$username" ;;
                esac
                ;;
            "è¿ç»´éƒ¨")
                usermod -g ops "$username"
                case "$position" in
                    *"ç³»ç»Ÿ"*) usermod -a -G sysadmin "$username" ;;
                    *"ç½‘ç»œ"*) usermod -a -G network "$username" ;;
                esac
                ;;
            "äº§å“éƒ¨")
                usermod -g product "$username"
                case "$position" in
                    *"è®¾è®¡"*) usermod -a -G design "$username" ;;
                    *"æµ‹è¯•"*) usermod -a -G qa "$username" ;;
                esac
                ;;
        esac
        
        echo "âœ… $username å·²åˆ†é…åˆ°å¯¹åº”ç”¨æˆ·ç»„"
    done < users.txt
}

# æ˜¾ç¤ºç”¨æˆ·ç»„æˆå‘˜ä¿¡æ¯
show_group_members() {
    echo "ğŸ“‹ ç”¨æˆ·ç»„æˆå‘˜ç»Ÿè®¡:"
    
    for group in dev ops product frontend backend sysadmin network design qa; do
        if getent group "$group" >/dev/null 2>&1; then
            local members=$(getent group "$group" | cut -d: -f4)
            local count=$(echo "$members" | grep -o "," | wc -l)
            [[ -n "$members" ]] && ((count++))
            
            echo "  $group: $countäºº ($members)"
        fi
    done
}
```

---

## 6. âš¡ sudoæƒé™æ‰¹é‡é…ç½®


### 6.1 sudoæƒé™è®¾è®¡åŸåˆ™


**ğŸ” æƒé™åˆ†çº§ç®¡ç†**
```
æƒé™çº§åˆ«è®¾è®¡ï¼š
ğŸ”´ è¶…çº§ç®¡ç†å‘˜ï¼šå®Œå…¨sudoæƒé™
ğŸŸ¡ éƒ¨é—¨ç®¡ç†å‘˜ï¼šéƒ¨é—¨ç›¸å…³å‘½ä»¤æƒé™
ğŸŸ¢ æ™®é€šç”¨æˆ·ï¼šåŸºç¡€ç³»ç»Ÿå‘½ä»¤æƒé™
âšª å—é™ç”¨æˆ·ï¼šä»…ç‰¹å®šåº”ç”¨æƒé™
```

### 6.2 sudoé…ç½®æ¨¡æ¿


**ğŸ“‹ sudoè§„åˆ™é…ç½®**
```bash
#!/bin/bash
# sudo_manager.sh - sudoæƒé™æ‰¹é‡é…ç½®

SUDOERS_DIR="/etc/sudoers.d"
BACKUP_DIR="/etc/sudoers.d/backup"

# åˆ›å»ºsudoè§„åˆ™æ–‡ä»¶
create_sudo_rules() {
    mkdir -p "$BACKUP_DIR"
    
    # ç³»ç»Ÿç®¡ç†å‘˜æƒé™
    cat > "$SUDOERS_DIR/sysadmins" << 'EOF'
# ç³»ç»Ÿç®¡ç†å‘˜ç»„æƒé™
%sysadmin ALL=(ALL:ALL) ALL

# å…è®¸ç³»ç»Ÿç®¡ç†å‘˜æ— å¯†ç æ‰§è¡Œç³»ç»ŸæœåŠ¡å‘½ä»¤
%sysadmin ALL=(ALL) NOPASSWD: /bin/systemctl, /usr/sbin/service
EOF

    # å¼€å‘äººå‘˜æƒé™
    cat > "$SUDOERS_DIR/developers" << 'EOF'
# å¼€å‘äººå‘˜æƒé™
%dev ALL=(ALL) /usr/bin/docker, /usr/local/bin/docker-compose
%dev ALL=(ALL) /bin/systemctl restart nginx, /bin/systemctl reload nginx
%dev ALL=(ALL) /usr/bin/tail, /usr/bin/less, /usr/bin/grep
EOF

    # è¿ç»´äººå‘˜æƒé™  
    cat > "$SUDOERS_DIR/operations" << 'EOF'
# è¿ç»´äººå‘˜æƒé™
%ops ALL=(ALL:ALL) ALL
%ops ALL=(ALL) NOPASSWD: /bin/systemctl, /usr/sbin/service
%ops ALL=(ALL) NOPASSWD: /usr/bin/iptables, /usr/sbin/ufw
EOF

    echo "âœ… sudoè§„åˆ™æ–‡ä»¶å·²åˆ›å»º"
}

# éªŒè¯sudoé…ç½®
validate_sudo_config() {
    echo "ğŸ” éªŒè¯sudoé…ç½®è¯­æ³•..."
    
    if visudo -c; then
        echo "âœ… sudoé…ç½®è¯­æ³•æ­£ç¡®"
    else
        echo "âŒ sudoé…ç½®è¯­æ³•é”™è¯¯ï¼Œè¯·æ£€æŸ¥"
        return 1
    fi
}
```

### 6.3 æƒé™å®¡è®¡åŠŸèƒ½


**ğŸ“Š sudoæƒé™å®¡è®¡**
```bash
# sudoæƒé™å®¡è®¡æŠ¥å‘Š
generate_sudo_audit() {
    local report_file="sudo_audit_$(date +%Y%m%d).txt"
    
    {
        echo "==============================================="
        echo "           SUDOæƒé™å®¡è®¡æŠ¥å‘Š"
        echo "==============================================="
        echo "ç”Ÿæˆæ—¶é—´: $(date)"
        echo ""
        
        echo "ğŸ” ç”¨æˆ·sudoæƒé™ç»Ÿè®¡:"
        echo "----------------------------------------"
        
        # ç»Ÿè®¡æœ‰sudoæƒé™çš„ç”¨æˆ·
        local sudo_users=()
        while IFS=':' read -r username _; do
            if groups "$username" | grep -q sudo; then
                sudo_users+=("$username")
            fi
        done < <(getent passwd | awk -F: '$3 >= 1000 && $3 < 65534')
        
        echo "æœ‰sudoæƒé™çš„ç”¨æˆ·: ${#sudo_users[@]}äºº"
        for user in "${sudo_users[@]}"; do
            local user_groups=$(groups "$user" | cut -d: -f2)
            echo "  $user: $user_groups"
        done
        
        echo ""
        echo "ğŸ“‹ sudoè§„åˆ™æ–‡ä»¶:"
        echo "----------------------------------------"
        find "$SUDOERS_DIR" -type f -name "*" -exec basename {} \; | sort
        
    } > "$report_file"
    
    echo "ğŸ“Š å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

---

## 7. ğŸ  ç”¨æˆ·å®¶ç›®å½•æ ‡å‡†åŒ–


### 7.1 å®¶ç›®å½•ç»“æ„è®¾è®¡


**ğŸ“ æ ‡å‡†ç›®å½•ç»“æ„**
```
ç”¨æˆ·å®¶ç›®å½•æ ‡å‡†å¸ƒå±€ï¼š
/home/username/
â”œâ”€â”€ bin/              # ä¸ªäººå¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ tmp/              # ä¸´æ—¶æ–‡ä»¶ç›®å½•
â”œâ”€â”€ logs/             # ä¸ªäººæ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ backup/           # å¤‡ä»½æ–‡ä»¶ç›®å½•
â”œâ”€â”€ projects/         # é¡¹ç›®å·¥ä½œç›®å½•
â”‚   â”œâ”€â”€ current/      # å½“å‰é¡¹ç›®
â”‚   â””â”€â”€ archive/      # å†å²é¡¹ç›®
â””â”€â”€ .config/          # åº”ç”¨é…ç½®ç›®å½•
    â”œâ”€â”€ shell/        # Shellé…ç½®
    â””â”€â”€ tools/        # å·¥å…·é…ç½®
```

### 7.2 å®¶ç›®å½•æ ‡å‡†åŒ–è„šæœ¬


**ğŸ—ï¸ ç›®å½•ç»“æ„æ ‡å‡†åŒ–**
```bash
#!/bin/bash
# home_standardize.sh - ç”¨æˆ·å®¶ç›®å½•æ ‡å‡†åŒ–

TEMPLATE_DIR="/etc/skel.custom"
STANDARD_DIRS=("bin" "tmp" "logs" "backup" "projects/current" "projects/archive" ".config/shell" ".config/tools")

# åˆ›å»ºæ ‡å‡†æ¨¡æ¿ç›®å½•
create_template() {
    echo "ğŸ“ åˆ›å»ºå®¶ç›®å½•æ¨¡æ¿..."
    
    mkdir -p "$TEMPLATE_DIR"
    
    # åˆ›å»ºæ ‡å‡†ç›®å½•ç»“æ„
    for dir in "${STANDARD_DIRS[@]}"; do
        mkdir -p "$TEMPLATE_DIR/$dir"
    done
    
    # åˆ›å»ºæ ‡å‡†é…ç½®æ–‡ä»¶
    cat > "$TEMPLATE_DIR/.bashrc_custom" << 'EOF'
# ç”¨æˆ·è‡ªå®šä¹‰bashrcé…ç½®
export PATH="$HOME/bin:$PATH"

# å¸¸ç”¨åˆ«å
alias ll='ls -la'
alias la='ls -A'
alias grep='grep --color=auto'

# é¡¹ç›®å¿«æ·è·³è½¬
alias proj='cd ~/projects/current'
alias logs='cd ~/logs'
EOF

    # åˆ›å»ºgitconfigæ¨¡æ¿
    cat > "$TEMPLATE_DIR/.gitconfig" << 'EOF'
[user]
    name = USER_FULL_NAME
    email = USER_EMAIL
[core]
    editor = vim
[alias]
    st = status
    ci = commit
    co = checkout
    br = branch
EOF

    echo "âœ… å®¶ç›®å½•æ¨¡æ¿å·²åˆ›å»º"
}

# æ ‡å‡†åŒ–ç°æœ‰ç”¨æˆ·å®¶ç›®å½•
standardize_home_directories() {
    echo "ğŸ  å¼€å§‹æ ‡å‡†åŒ–ç”¨æˆ·å®¶ç›®å½•..."
    
    while IFS=':' read -r username _ uid _ _ home_dir _; do
        # åªå¤„ç†æ™®é€šç”¨æˆ·
        [[ "$uid" -ge 1000 && "$uid" -lt 65534 ]] || continue
        [[ -d "$home_dir" ]] || continue
        
        echo "ğŸ“‚ å¤„ç†ç”¨æˆ·: $username"
        
        # åˆ›å»ºæ ‡å‡†ç›®å½•
        for dir in "${STANDARD_DIRS[@]}"; do
            local target_dir="$home_dir/$dir"
            if [[ ! -d "$target_dir" ]]; then
                mkdir -p "$target_dir"
                chown "$username:$username" "$target_dir"
                echo "  âœ… åˆ›å»ºç›®å½•: $dir"
            fi
        done
        
        # å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
        if [[ -f "$TEMPLATE_DIR/.bashrc_custom" && ! -f "$home_dir/.bashrc_custom" ]]; then
            cp "$TEMPLATE_DIR/.bashrc_custom" "$home_dir/"
            chown "$username:$username" "$home_dir/.bashrc_custom"
            
            # åœ¨.bashrcä¸­æ·»åŠ sourceè¯­å¥
            if ! grep -q ".bashrc_custom" "$home_dir/.bashrc"; then
                echo "" >> "$home_dir/.bashrc"
                echo "# åŠ è½½è‡ªå®šä¹‰é…ç½®" >> "$home_dir/.bashrc"
                echo "source ~/.bashrc_custom" >> "$home_dir/.bashrc"
            fi
        fi
        
    done < /etc/passwd
}
```

### 7.3 é…ç½®æ–‡ä»¶ä¸ªæ€§åŒ–


**âš™ï¸ ä¸ªæ€§åŒ–é…ç½®éƒ¨ç½²**
```bash
# ä¸ªæ€§åŒ–ç”¨æˆ·é…ç½®
personalize_user_config() {
    local username="$1"
    local fullname="$2"
    local email="$3"
    local home_dir="/home/$username"
    
    # ä¸ªæ€§åŒ–gité…ç½®
    if [[ -f "$home_dir/.gitconfig" ]]; then
        sed -i "s/USER_FULL_NAME/$fullname/g" "$home_dir/.gitconfig"
        sed -i "s/USER_EMAIL/$email/g" "$home_dir/.gitconfig"
        chown "$username:$username" "$home_dir/.gitconfig"
    fi
    
    # åˆ›å»ºä¸ªäººREADME
    cat > "$home_dir/README.txt" << EOF
æ¬¢è¿ $fullnameï¼

è¿™æ˜¯æ‚¨çš„Linuxç”¨æˆ·è´¦æˆ·ï¼Œç›®å½•ç»“æ„è¯´æ˜ï¼š
- bin/: å­˜æ”¾æ‚¨çš„ä¸ªäººè„šæœ¬å’Œå¯æ‰§è¡Œæ–‡ä»¶
- projects/: å·¥ä½œé¡¹ç›®ç›®å½•
  - current/: å½“å‰è¿›è¡Œçš„é¡¹ç›®
  - archive/: å·²å®Œæˆçš„é¡¹ç›®å½’æ¡£
- logs/: ä¸ªäººæ—¥å¿—æ–‡ä»¶
- backup/: é‡è¦æ–‡ä»¶å¤‡ä»½

é…ç½®æ–‡ä»¶ï¼š
- .bashrc_custom: ä¸ªäººshellé…ç½®
- .gitconfig: Gitä¸ªäººè®¾ç½®

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ã€‚
EOF
    
    chown "$username:$username" "$home_dir/README.txt"
    echo "âœ… å·²ä¸º $username åˆ›å»ºä¸ªæ€§åŒ–é…ç½®"
}
```

---

## 8. â° è´¦æˆ·è¿‡æœŸç­–ç•¥ç®¡ç†


### 8.1 è´¦æˆ·ç”Ÿå‘½å‘¨æœŸè®¾è®¡


**ğŸ“… è´¦æˆ·çŠ¶æ€ç®¡ç†**
- **ğŸŸ¢ æ´»è·ƒæœŸ**ï¼šæ­£å¸¸ä½¿ç”¨é˜¶æ®µï¼ˆ0-90å¤©ï¼‰
- **ğŸŸ¡ é¢„è­¦æœŸ**ï¼šå³å°†è¿‡æœŸæé†’ï¼ˆ90-120å¤©ï¼‰
- **ğŸ”´ è¿‡æœŸæœŸ**ï¼šè´¦æˆ·è¢«é”å®šï¼ˆ120å¤©åï¼‰
- **âš« æ¸…ç†æœŸ**ï¼šè´¦æˆ·æ•°æ®æ¸…ç†ï¼ˆ150å¤©åï¼‰

### 8.2 è¿‡æœŸç­–ç•¥æ‰¹é‡é…ç½®


**â° è´¦æˆ·è¿‡æœŸç®¡ç†è„šæœ¬**
```bash
#!/bin/bash
# account_expiry.sh - è´¦æˆ·è¿‡æœŸç­–ç•¥ç®¡ç†

EXPIRY_LOG="account_expiry.log"

# è®¾ç½®è´¦æˆ·è¿‡æœŸç­–ç•¥
set_account_expiry() {
    local username="$1"
    local expiry_days="${2:-90}"  # é»˜è®¤90å¤©
    
    # è®¡ç®—è¿‡æœŸæ—¥æœŸ
    local expiry_date=$(date -d "+${expiry_days} days" +%Y-%m-%d)
    
    # è®¾ç½®è´¦æˆ·è¿‡æœŸ
    chage -E "$expiry_date" "$username"
    
    # è®¾ç½®å¯†ç ç­–ç•¥
    chage -M 30 "$username"  # å¯†ç 30å¤©è¿‡æœŸ
    chage -W 7 "$username"   # è¿‡æœŸå‰7å¤©è­¦å‘Š
    chage -I 7 "$username"   # è¿‡æœŸå7å¤©ç¦ç”¨
    
    echo "â° ç”¨æˆ· $username è´¦æˆ·å°†åœ¨ $expiry_date è¿‡æœŸ"
}

# æ‰¹é‡è®¾ç½®ä¸´æ—¶è´¦æˆ·è¿‡æœŸ
set_temp_accounts_expiry() {
    echo "â° è®¾ç½®ä¸´æ—¶è´¦æˆ·è¿‡æœŸç­–ç•¥..."
    
    # ä¸ºå®ä¹ ç”Ÿè®¾ç½®3ä¸ªæœˆè¿‡æœŸ
    for username in $(getent group intern | cut -d: -f4 | tr ',' ' '); do
        [[ -n "$username" ]] && set_account_expiry "$username" 90
    done
    
    # ä¸ºè®¿å®¢è®¾ç½®1ä¸ªæœˆè¿‡æœŸ
    for username in $(getent group guest | cut -d: -f4 | tr ',' ' '); do
        [[ -n "$username" ]] && set_account_expiry "$username" 30
    done
    
    # ä¸ºé¡¹ç›®ä¸´æ—¶ç”¨æˆ·è®¾ç½®6ä¸ªæœˆè¿‡æœŸ
    for username in $(getent group temp_project | cut -d: -f4 | tr ',' ' '); do
        [[ -n "$username" ]] && set_account_expiry "$username" 180
    done
}
```

### 8.3 è¿‡æœŸè´¦æˆ·ç›‘æ§


**ğŸ“Š è´¦æˆ·çŠ¶æ€ç›‘æ§è„šæœ¬**
```bash
# æ£€æŸ¥å³å°†è¿‡æœŸçš„è´¦æˆ·
check_expiring_accounts() {
    local days_ahead="${1:-7}"  # æå‰7å¤©æ£€æŸ¥
    local today=$(date +%s)
    local threshold=$((today + days_ahead * 86400))
    
    echo "ğŸ” æ£€æŸ¥å³å°†åœ¨${days_ahead}å¤©å†…è¿‡æœŸçš„è´¦æˆ·..."
    
    {
        echo "è´¦æˆ·è¿‡æœŸçŠ¶æ€æŠ¥å‘Š - $(date)"
        echo "================================"
        
        local expiring_count=0
        local expired_count=0
        
        while IFS=':' read -r username _ uid _ _ _ _; do
            [[ "$uid" -ge 1000 && "$uid" -lt 65534 ]] || continue
            
            # è·å–è´¦æˆ·è¿‡æœŸä¿¡æ¯
            local expiry_info=$(chage -l "$username" 2>/dev/null)
            local expiry_date=$(echo "$expiry_info" | grep "Account expires" | awk -F': ' '{print $2}')
            
            if [[ "$expiry_date" != "never" ]]; then
                local expiry_timestamp=$(date -d "$expiry_date" +%s 2>/dev/null)
                
                if [[ -n "$expiry_timestamp" ]]; then
                    if [[ $expiry_timestamp -lt $today ]]; then
                        echo "ğŸ”´ å·²è¿‡æœŸ: $username (è¿‡æœŸæ—¥æœŸ: $expiry_date)"
                        ((expired_count++))
                    elif [[ $expiry_timestamp -lt $threshold ]]; then
                        local days_left=$(( (expiry_timestamp - today) / 86400 ))
                        echo "ğŸŸ¡ å³å°†è¿‡æœŸ: $username (è¿˜æœ‰${days_left}å¤©ï¼Œè¿‡æœŸæ—¥æœŸ: $expiry_date)"
                        ((expiring_count++))
                    fi
                fi
            fi
        done < /etc/passwd
        
        echo ""
        echo "ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:"
        echo "  å³å°†è¿‡æœŸè´¦æˆ·: $expiring_count ä¸ª"
        echo "  å·²è¿‡æœŸè´¦æˆ·: $expired_count ä¸ª"
        
    } | tee "$EXPIRY_LOG"
}

# æ¸…ç†è¿‡æœŸè´¦æˆ·
cleanup_expired_accounts() {
    local grace_days="${1:-30}"  # è¿‡æœŸå30å¤©æ‰æ¸…ç†
    local today=$(date +%s)
    local cleanup_threshold=$((today - grace_days * 86400))
    
    echo "ğŸ§¹ æ¸…ç†è¿‡æœŸè¶…è¿‡${grace_days}å¤©çš„è´¦æˆ·..."
    
    while IFS=':' read -r username _ uid _ _ home_dir _; do
        [[ "$uid" -ge 1000 && "$uid" -lt 65534 ]] || continue
        
        local expiry_info=$(chage -l "$username" 2>/dev/null)
        local expiry_date=$(echo "$expiry_info" | grep "Account expires" | awk -F': ' '{print $2}')
        
        if [[ "$expiry_date" != "never" ]]; then
            local expiry_timestamp=$(date -d "$expiry_date" +%s 2>/dev/null)
            
            if [[ -n "$expiry_timestamp" && $expiry_timestamp -lt $cleanup_threshold ]]; then
                echo "ğŸ—‘ï¸ å‡†å¤‡æ¸…ç†ç”¨æˆ·: $username (è¿‡æœŸæ—¥æœŸ: $expiry_date)"
                
                # å¤‡ä»½ç”¨æˆ·æ•°æ®
                local backup_dir="/var/backups/deleted_users/$(date +%Y%m%d)_$username"
                mkdir -p "$backup_dir"
                
                if [[ -d "$home_dir" ]]; then
                    tar -czf "$backup_dir/home_backup.tar.gz" -C "$(dirname $home_dir)" "$(basename $home_dir)"
                    echo "  ğŸ“¦ å·²å¤‡ä»½å®¶ç›®å½•åˆ°: $backup_dir"
                fi
                
                # åˆ é™¤ç”¨æˆ·è´¦æˆ·
                userdel -r "$username" 2>/dev/null
                echo "  âœ… ç”¨æˆ·è´¦æˆ·å·²åˆ é™¤"
            fi
        fi
    done < /etc/passwd
}
```

---

## 9. ğŸ” ç”¨æˆ·ä¿¡æ¯æ‰¹é‡æŸ¥è¯¢


### 9.1 ç”¨æˆ·ä¿¡æ¯æ±‡æ€»è„šæœ¬


**ğŸ“Š ç»¼åˆç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢**
```bash
#!/bin/bash
# user_query.sh - ç”¨æˆ·ä¿¡æ¯æ‰¹é‡æŸ¥è¯¢

REPORT_FILE="user_info_report_$(date +%Y%m%d).txt"

# ç”Ÿæˆç”¨æˆ·ä¿¡æ¯æŠ¥å‘Š
generate_user_report() {
    {
        echo "==============================================="
        echo "           ç”¨æˆ·ä¿¡æ¯æ±‡æ€»æŠ¥å‘Š"
        echo "==============================================="
        echo "ç”Ÿæˆæ—¶é—´: $(date)"
        echo ""
        
        # ç³»ç»Ÿç”¨æˆ·ç»Ÿè®¡
        local total_users=$(getent passwd | wc -l)
        local system_users=$(awk -F: '$3 < 1000 {count++} END {print count+0}' /etc/passwd)
        local normal_users=$(awk -F: '$3 >= 1000 && $3 < 65534 {count++} END {print count+0}' /etc/passwd)
        
        echo "ğŸ“Š ç”¨æˆ·æ•°é‡ç»Ÿè®¡:"
        echo "  æ€»ç”¨æˆ·æ•°: $total_users"
        echo "  ç³»ç»Ÿç”¨æˆ·: $system_users"
        echo "  æ™®é€šç”¨æˆ·: $normal_users"
        echo ""
        
        # ç”¨æˆ·ç»„ç»Ÿè®¡
        local total_groups=$(getent group | wc -l)
        echo "ğŸ‘¥ ç”¨æˆ·ç»„ç»Ÿè®¡:"
        echo "  æ€»ç»„æ•°: $total_groups"
        echo ""
        
        # è¯¦ç»†ç”¨æˆ·ä¿¡æ¯
        echo "ğŸ“‹ æ™®é€šç”¨æˆ·è¯¦ç»†ä¿¡æ¯:"
        echo "----------------------------------------"
        printf "%-15s %-8s %-15s %-20s %-15s %-10s\n" "ç”¨æˆ·å" "UID" "ä¸»ç»„" "é™„åŠ ç»„" "å®¶ç›®å½•" "Shell"
        echo "----------------------------------------"
        
        while IFS=':' read -r username _ uid gid _ home_dir shell; do
            [[ "$uid" -ge 1000 && "$uid" -lt 65534 ]] || continue
            
            local primary_group=$(getent group "$gid" | cut -d: -f1)
            local secondary_groups=$(groups "$username" 2>/dev/null | cut -d: -f2 | xargs)
            
            printf "%-15s %-8s %-15s %-20s %-15s %-10s\n" \
                "$username" "$uid" "$primary_group" "$secondary_groups" "$home_dir" "$(basename $shell)"
        done < /etc/passwd
        
    } > "$REPORT_FILE"
    
    echo "ğŸ“Š ç”¨æˆ·ä¿¡æ¯æŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE"
}
```

### 9.2 ç”¨æˆ·æ´»åŠ¨ç›‘æ§


**ğŸ“ˆ ç”¨æˆ·ç™»å½•æ´»åŠ¨åˆ†æ**
```bash
# åˆ†æç”¨æˆ·ç™»å½•æ´»åŠ¨
analyze_user_activity() {
    echo "ğŸ“ˆ åˆ†æç”¨æˆ·ç™»å½•æ´»åŠ¨..."
    
    local activity_report="user_activity_$(date +%Y%m%d).txt"
    
    {
        echo "ç”¨æˆ·æ´»åŠ¨åˆ†ææŠ¥å‘Š"
        echo "================"
        echo "åˆ†ææ—¶é—´: $(date)"
        echo ""
        
        echo "ğŸ” æœ€è¿‘7å¤©ç™»å½•ç”¨æˆ·:"
        echo "-------------------"
        
        # åˆ†ææœ€è¿‘ç™»å½•çš„ç”¨æˆ·
        last -n 50 | grep -v "^$" | while read -r line; do
            local user=$(echo "$line" | awk '{print $1}')
            local tty=$(echo "$line" | awk '{print $2}')
            local date=$(echo "$line" | awk '{print $3,$4,$5}')
            
            [[ "$user" =~ ^(reboot|wtmp)$ ]] && continue
            
            echo "$user åœ¨ $date ä» $tty ç™»å½•"
        done | sort | uniq -c | sort -rn | head -20
        
        echo ""
        echo "ğŸ”’ å½“å‰åœ¨çº¿ç”¨æˆ·:"
        echo "----------------"
        who
        
        echo ""
        echo "ğŸ“Š ç”¨æˆ·Shellä½¿ç”¨ç»Ÿè®¡:"
        echo "--------------------"
        awk -F: '$3 >= 1000 && $3 < 65534 {shells[$7]++} END {for (shell in shells) print shell ": " shells[shell]}' /etc/passwd
        
    } > "$activity_report"
    
    echo "ğŸ“ˆ æ´»åŠ¨åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ: $activity_report"
}
```

### 9.3 ç”¨æˆ·æƒé™å®¡è®¡


**ğŸ” æƒé™å®¡è®¡åŠŸèƒ½**
```bash
# ç”¨æˆ·æƒé™ç»¼åˆå®¡è®¡
audit_user_permissions() {
    local audit_file="permission_audit_$(date +%Y%m%d).txt"
    
    {
        echo "ç”¨æˆ·æƒé™å®¡è®¡æŠ¥å‘Š"
        echo "================"
        echo ""
        
        echo "ğŸ” å…·æœ‰ç‰¹æ®Šæƒé™çš„ç”¨æˆ·:"
        echo "---------------------"
        
        # sudoæƒé™ç”¨æˆ·
        echo "Sudoæƒé™ç”¨æˆ·:"
        getent group sudo | cut -d: -f4 | tr ',' '\n' | while read -r user; do
            [[ -n "$user" ]] && echo "  $user (sudoç»„)"
        done
        
        # wheelç»„ç”¨æˆ·
        if getent group wheel >/dev/null 2>&1; then
            echo "Wheelç»„ç”¨æˆ·:"
            getent group wheel | cut -d: -f4 | tr ',' '\n' | while read -r user; do
                [[ -n "$user" ]] && echo "  $user (wheelç»„)"
            done
        fi
        
        echo ""
        echo "ğŸ”‘ SSHå¯†é’¥é…ç½®çŠ¶æ€:"
        echo "-------------------"
        
        while IFS=':' read -r username _ uid _ _ home_dir _; do
            [[ "$uid" -ge 1000 && "$uid" -lt 65534 ]] || continue
            
            local ssh_dir="$home_dir/.ssh"
            if [[ -d "$ssh_dir" ]]; then
                local has_private_key=false
                local has_authorized_keys=false
                
                [[ -f "$ssh_dir/id_rsa" || -f "$ssh_dir/id_dsa" || -f "$ssh_dir/id_ecdsa" ]] && has_private_key=true
                [[ -f "$ssh_dir/authorized_keys" ]] && has_authorized_keys=true
                
                echo "$username: ç§é’¥=$has_private_key, æˆæƒå¯†é’¥=$has_authorized_keys"
            fi
        done < /etc/passwd
        
        echo ""
        echo "ğŸ“‹ ç”¨æˆ·å®¶ç›®å½•æƒé™æ£€æŸ¥:"
        echo "---------------------"
        
        while IFS=':' read -r username _ uid _ _ home_dir _; do
            [[ "$uid" -ge 1000 && "$uid" -lt 65534 ]] || continue
            
            if [[ -d "$home_dir" ]]; then
                local perm=$(ls -ld "$home_dir" | cut -d' ' -f1)
                local owner=$(ls -ld "$home_dir" | cut -d' ' -f3)
                echo "$username: $home_dir ($perm) æ‰€æœ‰è€…:$owner"
            fi
        done < /etc/passwd
        
    } > "$audit_file"
    
    echo "ğŸ” æƒé™å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ: $audit_file"
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ‰¹é‡ç®¡ç†æœ¬è´¨ï¼šé€šè¿‡è„šæœ¬è‡ªåŠ¨åŒ–å¤„ç†å¤§é‡ç”¨æˆ·è´¦æˆ·çš„åˆ›å»ºå’Œé…ç½®
ğŸ”¸ ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶ï¼š/etc/passwdã€/etc/shadowã€/etc/groupæ˜¯æ ¸å¿ƒé…ç½®æ–‡ä»¶
ğŸ”¸ å¯†ç å®‰å…¨ç­–ç•¥ï¼šéšæœºå¯†ç ç”Ÿæˆã€å¼ºåˆ¶é¦–æ¬¡ä¿®æ”¹ã€å®šæœŸè¿‡æœŸæ›´æ–°
ğŸ”¸ SSHå¯†é’¥è®¤è¯ï¼šæ¯”å¯†ç æ›´å®‰å…¨çš„è®¤è¯æ–¹å¼ï¼Œæ”¯æŒæ— å¯†ç ç™»å½•
ğŸ”¸ ç”¨æˆ·ç»„ç®¡ç†ï¼šæŒ‰éƒ¨é—¨å’ŒèŒèƒ½ç»„ç»‡ç”¨æˆ·ï¼Œä¾¿äºæƒé™ç®¡ç†
ğŸ”¸ sudoæƒé™åˆ†çº§ï¼šä¸åŒçº§åˆ«ç”¨æˆ·ç»™äºˆä¸åŒçš„ç®¡ç†æƒé™
ğŸ”¸ å®¶ç›®å½•æ ‡å‡†åŒ–ï¼šç»Ÿä¸€çš„ç›®å½•ç»“æ„å’Œé…ç½®æ–‡ä»¶ï¼Œæé«˜ç®¡ç†æ•ˆç‡
ğŸ”¸ è´¦æˆ·ç”Ÿå‘½å‘¨æœŸï¼šä»åˆ›å»ºåˆ°è¿‡æœŸæ¸…ç†çš„å®Œæ•´ç®¡ç†æµç¨‹
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦æ‰¹é‡ç”¨æˆ·ç®¡ç†**
```
è§„æ¨¡åŒ–éœ€æ±‚ï¼š
- æ–°å‘˜å·¥æ‰¹é‡å…¥èŒ
- é¡¹ç›®ç»„å¿«é€Ÿç»„å»º
- ç³»ç»Ÿè¿ç§»ç”¨æˆ·å¯¼å…¥
- ä¸´æ—¶è´¦æˆ·æ‰¹é‡åˆ›å»º

ä¸€è‡´æ€§è¦æ±‚ï¼š
- ç»Ÿä¸€çš„å®‰å…¨ç­–ç•¥
- æ ‡å‡†åŒ–çš„ç›®å½•ç»“æ„
- ä¸€è‡´çš„æƒé™é…ç½®
- è§„èŒƒçš„å‘½åè§„åˆ™
```

**ğŸ”¹ æ‰¹é‡ç®¡ç†çš„æ ¸å¿ƒåŸåˆ™**
```
å®‰å…¨ç¬¬ä¸€ï¼š
- å¼ºå¯†ç ç­–ç•¥
- æœ€å°æƒé™åŸåˆ™
- å®šæœŸæƒé™å®¡è®¡
- è´¦æˆ·è¿‡æœŸç®¡ç†

æ ‡å‡†åŒ–ï¼š
- ç»Ÿä¸€å‘½åè§„èŒƒ
- æ ‡å‡†ç›®å½•ç»“æ„
- ä¸€è‡´é…ç½®æ¨¡æ¿
- è§„èŒƒæ“ä½œæµç¨‹

å¯è¿½æº¯ï¼š
- å®Œæ•´æ“ä½œæ—¥å¿—
- ç”¨æˆ·å˜æ›´è®°å½•
- æƒé™åˆ†é…å†å²
- å®šæœŸå®¡è®¡æŠ¥å‘Š
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¼ä¸šåœºæ™¯åº”ç”¨**
- **äººå‘˜å…¥èŒ**ï¼šå¿«é€Ÿä¸ºæ–°å‘˜å·¥åˆ›å»ºæ ‡å‡†åŒ–è´¦æˆ·
- **éƒ¨é—¨é‡ç»„**ï¼šæ‰¹é‡è°ƒæ•´ç”¨æˆ·ç»„å½’å±å’Œæƒé™
- **é¡¹ç›®ç®¡ç†**ï¼šä¸ºé¡¹ç›®ç»„å¿«é€Ÿé…ç½®ä¸“ç”¨è´¦æˆ·
- **å®‰å…¨å®¡è®¡**ï¼šå®šæœŸæ£€æŸ¥ç”¨æˆ·æƒé™å’Œè´¦æˆ·çŠ¶æ€
- **ç³»ç»Ÿè¿ç§»**ï¼šæ‰¹é‡è¿ç§»ç”¨æˆ·è´¦æˆ·åˆ°æ–°ç³»ç»Ÿ

**ğŸ’° ROIæ•ˆç›Šåˆ†æ**
```
æ•ˆç‡æå‡ï¼š
æ‰‹å·¥ç®¡ç†1ä¸ªç”¨æˆ·: 30åˆ†é’Ÿ
æ‰¹é‡ç®¡ç†100ä¸ªç”¨æˆ·: 10åˆ†é’Ÿ
æ•ˆç‡æå‡: 300å€

é”™è¯¯å‡å°‘ï¼š
æ‰‹å·¥æ“ä½œé”™è¯¯ç‡: 5-10%
è„šæœ¬è‡ªåŠ¨åŒ–é”™è¯¯ç‡: <1%

æ ‡å‡†åŒ–æ”¶ç›Šï¼š
- å‡å°‘é…ç½®ä¸ä¸€è‡´é—®é¢˜
- é™ä½å®‰å…¨æ¼æ´é£é™©
- æé«˜è¿ç»´ç®¡ç†æ•ˆç‡
```

### 10.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ› ï¸ è„šæœ¬å¼€å‘å»ºè®®**
```
ä»£ç è´¨é‡ï¼š
- ä½¿ç”¨set -euo pipefailä¸¥æ ¼æ¨¡å¼
- æ¯ä¸ªæ“ä½œéƒ½è¦æ£€æŸ¥è¿”å›å€¼
- æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•
- æä¾›å›æ»šå’Œæ¸…ç†æœºåˆ¶

ç”¨æˆ·ä½“éªŒï¼š
- æ¸…æ™°çš„å¸®åŠ©ä¿¡æ¯
- å‹å¥½çš„é”™è¯¯æç¤º
- è¿›åº¦æ˜¾ç¤ºå’ŒçŠ¶æ€åé¦ˆ
- æ”¯æŒdry-runé¢„è§ˆæ¨¡å¼
```

**ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
æƒé™æ§åˆ¶ï¼š
- è„šæœ¬åªèƒ½rootæ‰§è¡Œ
- æ•æ„Ÿæ–‡ä»¶æƒé™è®¾ç½®æ­£ç¡®
- å¯†ç æ–‡ä»¶åŠ å¯†å­˜å‚¨
- å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶

æ“ä½œå®¡è®¡ï¼š
- è®°å½•æ‰€æœ‰ç”¨æˆ·å˜æ›´æ“ä½œ
- ä¿ç•™æ“ä½œæ—¥å¿—å¤‡æŸ¥
- å®šæœŸæ£€æŸ¥å¼‚å¸¸è´¦æˆ·
- ç›‘æ§ç‰¹æƒè´¦æˆ·ä½¿ç”¨
```

### 10.5 å­¦ä¹ æ£€æŸ¥æ¸…å•


**ğŸ“ æŠ€èƒ½æŒæ¡æ£€æŸ¥**
- [ ] èƒ½ç¼–å†™åŸºç¡€çš„ç”¨æˆ·æ‰¹é‡åˆ›å»ºè„šæœ¬
- [ ] ç†è§£Linuxç”¨æˆ·ç®¡ç†ç›¸å…³æ–‡ä»¶ç»“æ„
- [ ] æŒæ¡å¯†ç å®‰å…¨ç­–ç•¥é…ç½®
- [ ] ä¼šéƒ¨ç½²å’Œç®¡ç†SSHå¯†é’¥è®¤è¯
- [ ] èƒ½è®¾è®¡åˆç†çš„ç”¨æˆ·ç»„æƒé™æ¶æ„
- [ ] æŒæ¡sudoæƒé™çš„åˆ†çº§ç®¡ç†
- [ ] èƒ½æ ‡å‡†åŒ–ç”¨æˆ·å®¶ç›®å½•é…ç½®
- [ ] äº†è§£è´¦æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [ ] èƒ½ç”Ÿæˆç”¨æˆ·ç®¡ç†å®¡è®¡æŠ¥å‘Š

**ğŸ¯ è¿›é˜¶å­¦ä¹ æ–¹å‘**
- **é…ç½®ç®¡ç†å·¥å…·**ï¼šå­¦ä¹ Ansibleã€Puppetç­‰è‡ªåŠ¨åŒ–å·¥å…·
- **LDAPé›†æˆ**ï¼šç ”ç©¶ä¼ä¸šçº§ç”¨æˆ·ç›®å½•æœåŠ¡
- **å®¹å™¨åŒ–ç¯å¢ƒ**ï¼šäº†è§£Docker/K8sä¸­çš„ç”¨æˆ·ç®¡ç†
- **äº‘å¹³å°é›†æˆ**ï¼šå­¦ä¹ äº‘æœåŠ¡å•†çš„ç”¨æˆ·ç®¡ç†API

**ğŸ”‘ æ ¸å¿ƒè®°å¿†å£è¯€**
> æ‰¹é‡ç®¡ç†ææ•ˆç‡ï¼Œç”¨æˆ·åˆ›å»ºè¦è§„èŒƒ
> å¯†ç ç­–ç•¥ä¿å®‰å…¨ï¼ŒSSHå¯†é’¥æ›´æ–¹ä¾¿
> ç”¨æˆ·åˆ†ç»„æƒé™æ¸…ï¼Œsudoé…ç½®è¦è°¨æ…
> å®¶ç›®å½•æ ‡å‡†åŒ–ï¼Œè´¦æˆ·è¿‡æœŸè¦ç®¡ç†
> å®šæœŸå®¡è®¡æŸ¥æƒé™ï¼Œæ—¥å¿—è®°å½•å¾ˆé‡è¦

**ğŸ’¡ å»¶ä¼¸æ€è€ƒ**
- å¦‚ä½•è®¾è®¡é€‚åˆä¸åŒè§„æ¨¡ä¼ä¸šçš„ç”¨æˆ·ç®¡ç†æ–¹æ¡ˆï¼Ÿ
- æ€æ ·å¹³è¡¡ç”¨æˆ·ä¾¿åˆ©æ€§å’Œç³»ç»Ÿå®‰å…¨æ€§ï¼Ÿ
- å¦‚ä½•åº”å¯¹ç”¨æˆ·è´¦æˆ·çš„åˆè§„æ€§è¦æ±‚ï¼Ÿ