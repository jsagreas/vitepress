---
title: 15ã€ç›‘æ§æ•…éšœæ’æŸ¥è¯Šæ–­
---
## ğŸ“š ç›®å½•

1. [ç›‘æ§ç³»ç»Ÿæ•…éšœåˆ†ç±»](#1-ç›‘æ§ç³»ç»Ÿæ•…éšœåˆ†ç±»)
2. [Prometheusæ•…éšœè¯Šæ–­](#2-prometheusæ•…éšœè¯Šæ–­)
3. [æ•°æ®é‡‡é›†é—®é¢˜æ’æŸ¥](#3-æ•°æ®é‡‡é›†é—®é¢˜æ’æŸ¥)
4. [å‘Šè­¦ä¸è§¦å‘é—®é¢˜](#4-å‘Šè­¦ä¸è§¦å‘é—®é¢˜)
5. [Grafanaæ˜¾ç¤ºå¼‚å¸¸](#5-grafanaæ˜¾ç¤ºå¼‚å¸¸)
6. [æ€§èƒ½é—®é¢˜å®šä½](#6-æ€§èƒ½é—®é¢˜å®šä½)
7. [é…ç½®é”™è¯¯æ’æŸ¥](#7-é…ç½®é”™è¯¯æ’æŸ¥)
8. [ç›‘æ§ç³»ç»Ÿæ¢å¤](#8-ç›‘æ§ç³»ç»Ÿæ¢å¤)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç›‘æ§ç³»ç»Ÿæ•…éšœåˆ†ç±»


### 1.1 ä»€ä¹ˆæ˜¯ç›‘æ§æ•…éšœ


**é€šä¿—ç†è§£**ï¼šå°±åƒå®¶é‡Œçš„æ¸©åº¦è®¡åäº†ï¼Œä½ å°±ä¸çŸ¥é“æˆ¿é—´çƒ­ä¸çƒ­ä¸€æ ·ï¼Œç›‘æ§ç³»ç»Ÿå‡ºé—®é¢˜äº†ï¼Œä½ å°±çœ‹ä¸åˆ°æœåŠ¡å™¨çš„"å¥åº·çŠ¶æ€"äº†ã€‚

ç›‘æ§æ•…éšœä¸»è¦åˆ†ä¸ºå‡ å¤§ç±»ï¼š

```
ç›‘æ§æ•…éšœåˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®é‡‡é›†å±‚     â”‚ â† Node Exporteré‡‡ä¸åˆ°æ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®å­˜å‚¨å±‚     â”‚ â† Prometheuså­˜ä¸è¿›æ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®æŸ¥è¯¢å±‚     â”‚ â† PromQLæŸ¥è¯¢æœ‰é—®é¢˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®å±•ç¤ºå±‚     â”‚ â† Grafanaæ˜¾ç¤ºä¸æ­£å¸¸
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å‘Šè­¦é€šçŸ¥å±‚     â”‚ â† å‘Šè­¦å‘ä¸å‡ºå»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ•…éšœä¸¥é‡ç¨‹åº¦åˆ†çº§


| ç­‰çº§ | **å½±å“èŒƒå›´** | **å…¸å‹ç—‡çŠ¶** | **å¤„ç†æ—¶é—´** |
|------|------------|------------|------------|
| ğŸ”´ **P0ä¸¥é‡** | `æ•´ä¸ªç›‘æ§ç³»ç»Ÿç˜«ç—ª` | `å®Œå…¨çœ‹ä¸åˆ°ç›‘æ§æ•°æ®` | `ç«‹å³å¤„ç†` |
| ğŸŸ  **P1é‡è¦** | `éƒ¨åˆ†å…³é”®æŒ‡æ ‡ç¼ºå¤±` | `CPUã€å†…å­˜ç­‰æ ¸å¿ƒæŒ‡æ ‡å¼‚å¸¸` | `1å°æ—¶å†…` |
| ğŸŸ¡ **P2ä¸€èˆ¬** | `éæ ¸å¿ƒæŒ‡æ ‡é—®é¢˜` | `æŸäº›å›¾è¡¨æ˜¾ç¤ºå¼‚å¸¸` | `4å°æ—¶å†…` |
| ğŸŸ¢ **P3è½»å¾®** | `å½±å“ç”¨æˆ·ä½“éªŒ` | `å›¾è¡¨æ ·å¼ã€æ ‡ç­¾é—®é¢˜` | `1å¤©å†…` |

### 1.3 å¸¸è§æ•…éšœæ¨¡å¼


**ğŸ”¸ æ•°æ®æ–­æµ**
```
ç°è±¡ï¼šç›‘æ§å›¾è¡¨çªç„¶æ²¡æ•°æ®äº†
åŸå› ï¼šé‡‡é›†å™¨åœæ­¢å·¥ä½œã€ç½‘ç»œä¸­æ–­ã€é…ç½®é”™è¯¯
å½±å“ï¼šæ— æ³•äº†è§£ç³»ç»Ÿç°çŠ¶ï¼Œå‘Šè­¦å¤±æ•ˆ
```

**ğŸ”¸ æ•°æ®å¼‚å¸¸**
```
ç°è±¡ï¼šæ•°æ®å€¼æ˜æ˜¾ä¸å¯¹ï¼Œæ¯”å¦‚CPUä½¿ç”¨ç‡æ˜¾ç¤º200%
åŸå› ï¼šè®¡ç®—å…¬å¼é”™è¯¯ã€å•ä½æ¢ç®—é—®é¢˜ã€æ—¶é—´åŒæ­¥å¼‚å¸¸
å½±å“ï¼šè¯¯å¯¼è¿ç»´å†³ç­–ï¼Œå¯èƒ½è§¦å‘é”™è¯¯å‘Šè­¦
```

**ğŸ”¸ å‘Šè­¦é£æš´**
```
ç°è±¡ï¼šçŸ­æ—¶é—´å†…æ”¶åˆ°å¤§é‡å‘Šè­¦é€šçŸ¥
åŸå› ï¼šé˜ˆå€¼è®¾ç½®ä¸åˆç†ã€çº§è”æ•…éšœã€é…ç½®é”™è¯¯
å½±å“ï¼šçœŸæ­£çš„é—®é¢˜è¢«æ·¹æ²¡ï¼Œè¿ç»´äººå‘˜ç–²åŠ³
```

---

## 2. ğŸ”§ Prometheusæ•…éšœè¯Šæ–­


### 2.1 PrometheusæœåŠ¡çŠ¶æ€æ£€æŸ¥


**ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ**

```bash
# æ£€æŸ¥Prometheusè¿›ç¨‹
ps aux | grep prometheus

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status prometheus

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep 9090
```

ğŸ’¡ **è¯Šæ–­æŠ€å·§**ï¼šå¦‚æœè¿›ç¨‹ä¸å­˜åœ¨ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼›å¦‚æœè¿›ç¨‹å­˜åœ¨ä½†ç«¯å£ä¸ç›‘å¬ï¼Œå¯èƒ½æ˜¯é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ã€‚

### 2.2 æ—¥å¿—æ–‡ä»¶åˆ†æ


**æŸ¥çœ‹Prometheusæ—¥å¿—**

```bash
# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
journalctl -u prometheus -f

# æŸ¥çœ‹å¯åŠ¨æ—¶çš„é”™è¯¯
journalctl -u prometheus --since "1 hour ago"
```

**ğŸ”¸ å¸¸è§é”™è¯¯æ¨¡å¼**

```
é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ï¼š
level=error msg="Error loading config" err="yaml: line 15: found character..."

å­˜å‚¨ç©ºé—´ä¸è¶³ï¼š
level=error msg="Unable to create mmap file" err="no space left on device"

æƒé™é—®é¢˜ï¼š
level=error msg="Opening storage failed" err="permission denied"
```

### 2.3 é…ç½®æ–‡ä»¶éªŒè¯


**æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•**

```bash
# éªŒè¯é…ç½®æ–‡ä»¶
promtool check config /etc/prometheus/prometheus.yml

# éªŒè¯å‘Šè­¦è§„åˆ™
promtool check rules /etc/prometheus/rules/*.yml
```

**ğŸ”¸ é…ç½®æ–‡ä»¶å¸¸è§é—®é¢˜**

```yaml
# âŒ é”™è¯¯å†™æ³•ï¼šç¼©è¿›ä¸å¯¹
global:
scrape_interval: 15s  # ç¼ºå°‘ç©ºæ ¼

# âœ… æ­£ç¡®å†™æ³•ï¼š
global:
  scrape_interval: 15s

# âŒ é”™è¯¯å†™æ³•ï¼šJobåç§°é‡å¤
scrape_configs:
  - job_name: 'node'
  - job_name: 'node'  # é‡å¤äº†

# âœ… æ­£ç¡®å†™æ³•ï¼šæ¯ä¸ªjobåç§°å”¯ä¸€
scrape_configs:
  - job_name: 'node-prod'
  - job_name: 'node-test'
```

### 2.4 å­˜å‚¨é—®é¢˜è¯Šæ–­


**æ£€æŸ¥å­˜å‚¨ç©ºé—´**

```bash
# æ£€æŸ¥Prometheusæ•°æ®ç›®å½•å¤§å°
du -sh /var/lib/prometheus/

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /var/lib/prometheus/
```

**å­˜å‚¨æ¸…ç†ç­–ç•¥**

```bash
# æ‰‹åŠ¨æ¸…ç†æ—§æ•°æ®ï¼ˆè°¨æ…æ“ä½œï¼‰
# åˆ é™¤7å¤©å‰çš„æ•°æ®
find /var/lib/prometheus/data -name "*.db" -mtime +7 -delete
```

âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šåˆ é™¤æ•°æ®å‰ä¸€å®šè¦å¤‡ä»½é‡è¦æ•°æ®ï¼Œç¡®ä¿ä¸ä¼šå½±å“æ­£åœ¨ä½¿ç”¨çš„æ—¶é—´åºåˆ—ã€‚

---

## 3. ğŸ“Š æ•°æ®é‡‡é›†é—®é¢˜æ’æŸ¥


### 3.1 Node Exporteræ•…éšœè¯Šæ–­


**æ£€æŸ¥Node ExporterçŠ¶æ€**

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status node_exporter

# æ£€æŸ¥ç«¯å£ï¼ˆé»˜è®¤9100ï¼‰
curl -s http://localhost:9100/metrics | head -10
```

**ğŸ”¸ å¸¸è§é‡‡é›†é—®é¢˜**

```
ç½‘ç»œè¿æ¥é—®é¢˜ï¼š
$ curl http://192.168.1.100:9100/metrics
curl: (7) Failed to connect to 192.168.1.100 port 9100: Connection refused

æƒé™é—®é¢˜ï¼š
node_filesystem_readonly{device="/dev/sda1"} 1
è¯´æ˜ï¼šæ–‡ä»¶ç³»ç»Ÿå˜æˆåªè¯»äº†

é˜²ç«å¢™é˜»æ–­ï¼š
$ telnet 192.168.1.100 9100
Trying 192.168.1.100...
telnet: Unable to connect to remote host: No route to host
```

### 3.2 Targetå¥åº·çŠ¶æ€æ£€æŸ¥


**åœ¨Prometheus Webç•Œé¢æ£€æŸ¥**
```
è®¿é—®ï¼šhttp://prometheus:9090/targets
æŸ¥çœ‹çŠ¶æ€ï¼šUPï¼ˆæ­£å¸¸ï¼‰/ DOWNï¼ˆå¼‚å¸¸ï¼‰
```

**TargetçŠ¶æ€å«ä¹‰**
- ğŸŸ¢ **UP**ï¼šç›®æ ‡æ­£å¸¸ï¼Œæ•°æ®é‡‡é›†æˆåŠŸ
- ğŸ”´ **DOWN**ï¼šç›®æ ‡å¼‚å¸¸ï¼Œæ— æ³•é‡‡é›†æ•°æ®
- ğŸŸ¡ **UNKNOWN**ï¼šçŠ¶æ€æœªçŸ¥ï¼Œé€šå¸¸æ˜¯åˆšæ·»åŠ çš„ç›®æ ‡

### 3.3 é‡‡é›†é¢‘ç‡é—®é¢˜


**è¯Šæ–­é‡‡é›†å»¶è¿Ÿ**

```bash
# æŸ¥çœ‹æœ€åä¸€æ¬¡é‡‡é›†æ—¶é—´
curl -s 'http://prometheus:9090/api/v1/query?query=up' | jq
```

**è°ƒæ•´é‡‡é›†é…ç½®**

```yaml
scrape_configs:
  - job_name: 'node'
    scrape_interval: 15s      # é‡‡é›†é—´éš”
    scrape_timeout: 10s       # è¶…æ—¶æ—¶é—´ï¼ˆè¦å°äºé‡‡é›†é—´éš”ï¼‰
    static_configs:
      - targets: ['localhost:9100']
```

ğŸ’¡ **ä¼˜åŒ–å»ºè®®**ï¼šé‡‡é›†é—´éš”ä¸è¦è®¾ç½®å¤ªçŸ­ï¼Œé€šå¸¸15-30ç§’å³å¯ï¼›è¶…æ—¶æ—¶é—´è¦å°äºé‡‡é›†é—´éš”ï¼Œé¿å…é‡å ã€‚

---

## 4. ğŸš¨ å‘Šè­¦ä¸è§¦å‘é—®é¢˜


### 4.1 å‘Šè­¦è§„åˆ™è¯Šæ–­


**æ£€æŸ¥å‘Šè­¦è§„åˆ™è¯­æ³•**

```bash
# éªŒè¯è§„åˆ™æ–‡ä»¶
promtool check rules /etc/prometheus/rules/alerts.yml
```

**å‘Šè­¦è§„åˆ™ç¤ºä¾‹ä¸å¸¸è§é”™è¯¯**

```yaml
# âŒ é”™è¯¯çš„è§„åˆ™å†™æ³•
groups:
- name: basic-alerts
  rules:
  - alert: HighCPU
    expr: cpu_usage > 80  # æŒ‡æ ‡åç§°å¯èƒ½ä¸å­˜åœ¨
    for: 5  # ç¼ºå°‘å•ä½

# âœ… æ­£ç¡®çš„è§„åˆ™å†™æ³•
groups:
- name: basic-alerts
  rules:
  - alert: HighCPU
    expr: 100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
      description: "{{ $labels.instance }} CPUä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼ï¼š{{ $value }}%"
```

### 4.2 å‘Šè­¦çŠ¶æ€æŸ¥çœ‹


**é€šè¿‡Webç•Œé¢æŸ¥çœ‹å‘Šè­¦**
```
è®¿é—®ï¼šhttp://prometheus:9090/alerts
çŠ¶æ€è¯´æ˜ï¼š
- Inactiveï¼šè§„åˆ™æ­£å¸¸ï¼Œä½†æ¡ä»¶æœªè§¦å‘
- Pendingï¼šæ¡ä»¶æ»¡è¶³ï¼Œç­‰å¾…æ—¶é—´åˆ°è¾¾
- Firingï¼šå‘Šè­¦å·²è§¦å‘
```

**å‘Šè­¦ç”Ÿå‘½å‘¨æœŸ**
```
æ¡ä»¶æ»¡è¶³ â†’ PendingçŠ¶æ€ â†’ ç­‰å¾…foræ—¶é—´ â†’ FiringçŠ¶æ€ â†’ å‘é€é€šçŸ¥
```

### 4.3 Alertmanageré…ç½®æ£€æŸ¥


**æ£€æŸ¥AlertmanageræœåŠ¡**

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status alertmanager

# æ£€æŸ¥é…ç½®æ–‡ä»¶
amtool check-config /etc/alertmanager/alertmanager.yml
```

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**

```yaml
global:
  smtp_smarthost: 'smtp.qq.com:587'
  smtp_from: 'monitor@company.com'

route:
  group_by: ['alertname', 'severity']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  receiver: 'default'

receivers:
- name: 'default'
  email_configs:
  - to: 'admin@company.com'
    subject: 'ã€å‘Šè­¦ã€‘{{ .GroupLabels.alertname }}'
    body: |
      å‘Šè­¦è¯¦æƒ…ï¼š
      {{ range .Alerts }}
      - {{ .Annotations.summary }}
      {{ end }}
```

---

## 5. ğŸ“ˆ Grafanaæ˜¾ç¤ºå¼‚å¸¸


### 5.1 Grafanaè¿æ¥é—®é¢˜


**æ£€æŸ¥GrafanaæœåŠ¡çŠ¶æ€**

```bash
# æ£€æŸ¥æœåŠ¡
systemctl status grafana-server

# æ£€æŸ¥æ—¥å¿—
journalctl -u grafana-server -f
```

**æ•°æ®æºè¿æ¥æµ‹è¯•**
```
1. ç™»å½•Grafanaç•Œé¢
2. è¿›å…¥Configuration â†’ Data Sources
3. é€‰æ‹©Prometheusæ•°æ®æº
4. ç‚¹å‡»"Test"æŒ‰é’®
5. çœ‹åˆ°"Data source is working"è¡¨ç¤ºæ­£å¸¸
```

### 5.2 å›¾è¡¨æ˜¾ç¤ºé—®é¢˜


**ğŸ”¸ å¸¸è§æ˜¾ç¤ºå¼‚å¸¸**

```
æ— æ•°æ®æ˜¾ç¤ºï¼š
å¯èƒ½åŸå› ï¼š
- PromQLæŸ¥è¯¢è¯­å¥é”™è¯¯
- æ—¶é—´èŒƒå›´é€‰æ‹©é—®é¢˜
- æ•°æ®æºé…ç½®é”™è¯¯

æ•°æ®ä¸å‡†ç¡®ï¼š
å¯èƒ½åŸå› ï¼š
- å•ä½æ¢ç®—é”™è¯¯
- èšåˆå‡½æ•°ä½¿ç”¨ä¸å½“
- æ—¶é—´çª—å£é€‰æ‹©ä¸åˆé€‚
```

**PromQLè°ƒè¯•æŠ€å·§**

```bash
# ç›´æ¥åœ¨Prometheusä¸­æµ‹è¯•æŸ¥è¯¢
curl -G 'http://prometheus:9090/api/v1/query' \
  --data-urlencode 'query=up' \
  --data-urlencode 'time=2023-01-01T00:00:00Z'
```

### 5.3 å›¾è¡¨æ€§èƒ½ä¼˜åŒ–


**æŸ¥è¯¢ä¼˜åŒ–å»ºè®®**

```yaml
# âŒ æ€§èƒ½å·®çš„æŸ¥è¯¢
rate(http_requests_total[1m])  # æ—¶é—´çª—å£å¤ªçŸ­

# âœ… ä¼˜åŒ–åçš„æŸ¥è¯¢
rate(http_requests_total[5m])  # é€‚å½“çš„æ—¶é—´çª—å£

# âŒ è¿‡äºå¤æ‚çš„æŸ¥è¯¢
sum(rate(http_requests_total[5m])) by (instance, job, method, status)

# âœ… ç®€åŒ–æŸ¥è¯¢
sum(rate(http_requests_total[5m])) by (instance)
```

ğŸ’¡ **æ€§èƒ½æç¤º**ï¼š
- æ—¶é—´çª—å£ä¸è¦å¤ªçŸ­ï¼ˆå»ºè®®5mä»¥ä¸Šï¼‰
- é¿å…è¿‡å¤šçš„æ ‡ç­¾èšåˆ
- åˆç†ä½¿ç”¨ç¼“å­˜å’Œåˆ·æ–°é—´éš”

---

## 6. âš¡ æ€§èƒ½é—®é¢˜å®šä½


### 6.1 ç³»ç»Ÿèµ„æºä½¿ç”¨ç›‘æ§


**ç›‘æ§ç³»ç»Ÿæœ¬èº«çš„èµ„æºæ¶ˆè€—**

```bash
# æŸ¥çœ‹Prometheusè¿›ç¨‹èµ„æºå ç”¨
top -p $(pgrep prometheus)

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨è¯¦æƒ…
cat /proc/$(pgrep prometheus)/status | grep -E "(VmRSS|VmSize)"
```

**èµ„æºä½¿ç”¨ä¼˜åŒ–**

```yaml
# Prometheuså¯åŠ¨å‚æ•°ä¼˜åŒ–
--storage.tsdb.retention.time=30d     # æ•°æ®ä¿ç•™30å¤©
--storage.tsdb.retention.size=10GB    # æœ€å¤§å­˜å‚¨10GB
--web.max-connections=512             # æœ€å¤§è¿æ¥æ•°
--query.max-concurrency=20           # æœ€å¤§æŸ¥è¯¢å¹¶å‘æ•°
```

### 6.2 æŸ¥è¯¢æ€§èƒ½åˆ†æ


**æ…¢æŸ¥è¯¢è¯†åˆ«**

```bash
# å¯ç”¨æŸ¥è¯¢æ—¥å¿—
--log.level=debug
--web.enable-lifecycle

# æŸ¥çœ‹æŸ¥è¯¢ç»Ÿè®¡
curl http://prometheus:9090/api/v1/status/runtimeinfo
```

**æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**

| é—®é¢˜ç±»å‹ | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|---------|-------------|
| ğŸŒ **æŸ¥è¯¢æ…¢** | `æ—¶é—´èŒƒå›´å¤ªå¤§` | `ç¼©å°æŸ¥è¯¢æ—¶é—´èŒƒå›´` |
| ğŸ’¾ **å†…å­˜å ç”¨é«˜** | `é«˜åŸºæ•°æ ‡ç­¾` | `å‡å°‘æ ‡ç­¾ç»´åº¦` |
| ğŸ”¥ **CPUä½¿ç”¨é«˜** | `å¤æ‚èšåˆè¿ç®—` | `ç®€åŒ–PromQLæŸ¥è¯¢` |
| ğŸ“Š **å›¾è¡¨åŠ è½½æ…¢** | `å¹¶å‘æŸ¥è¯¢è¿‡å¤š` | `å‡å°‘åŒæ—¶æ˜¾ç¤ºçš„é¢æ¿` |

---

## 7. âš™ï¸ é…ç½®é”™è¯¯æ’æŸ¥


### 7.1 é…ç½®æ–‡ä»¶å¸¸è§é”™è¯¯


**YAMLè¯­æ³•é”™è¯¯**

```yaml
# âŒ å¸¸è§é”™è¯¯ï¼šç¼©è¿›ä¸ä¸€è‡´
global:
  scrape_interval: 15s
    evaluation_interval: 15s  # ç¼©è¿›é”™è¯¯

# âœ… æ­£ç¡®å†™æ³•ï¼š
global:
  scrape_interval: 15s
  evaluation_interval: 15s
```

**å­—æ®µæ‹¼å†™é”™è¯¯**

```yaml
# âŒ å­—æ®µåæ‹¼å†™é”™è¯¯
scrape_configs:
  - job_name: 'node'
    scape_interval: 30s  # åº”è¯¥æ˜¯scrape_interval

# âœ… æ­£ç¡®å†™æ³•ï¼š
scrape_configs:
  - job_name: 'node'
    scrape_interval: 30s
```

### 7.2 ç½‘ç»œé…ç½®é—®é¢˜


**é˜²ç«å¢™è§„åˆ™æ£€æŸ¥**

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
systemctl status firewalld

# å¼€æ”¾Prometheusç«¯å£
firewall-cmd --permanent --add-port=9090/tcp
firewall-cmd --permanent --add-port=9100/tcp
firewall-cmd --reload
```

**ç½‘ç»œè¿é€šæ€§æµ‹è¯•**

```bash
# æµ‹è¯•ç«¯å£è¿é€šæ€§
telnet prometheus-server 9090

# æµ‹è¯•HTTPå“åº”
curl -I http://prometheus-server:9090/
```

### 7.3 æƒé™é—®é¢˜æ’æŸ¥


**æ–‡ä»¶æƒé™æ£€æŸ¥**

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™
ls -la /etc/prometheus/prometheus.yml

# æ£€æŸ¥æ•°æ®ç›®å½•æƒé™
ls -la /var/lib/prometheus/

# ä¿®æ­£æƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
chown -R prometheus:prometheus /var/lib/prometheus/
```

---

## 8. ğŸ”„ ç›‘æ§ç³»ç»Ÿæ¢å¤


### 8.1 å¿«é€Ÿæ¢å¤æ­¥éª¤


**ğŸ”¸ æ•…éšœæ¢å¤æµç¨‹**

```
æ•…éšœå‘ç° â†’ é—®é¢˜å®šä½ â†’ ç´§æ€¥å¤„ç† â†’ æ ¹æœ¬ä¿®å¤ â†’ éªŒè¯æ¢å¤
```

**åº”æ€¥å¤„ç†æ¸…å•**
- [ ] é‡å¯ç›¸å…³æœåŠ¡
- [ ] æ£€æŸ¥é…ç½®æ–‡ä»¶
- [ ] éªŒè¯ç½‘ç»œè¿é€šæ€§
- [ ] ç¡®è®¤æ•°æ®å®Œæ•´æ€§
- [ ] æµ‹è¯•å‘Šè­¦åŠŸèƒ½

### 8.2 æ•°æ®å¤‡ä»½ä¸æ¢å¤


**å¤‡ä»½é‡è¦é…ç½®**

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
cp -r /etc/prometheus /backup/prometheus-config-$(date +%Y%m%d)
cp -r /etc/grafana /backup/grafana-config-$(date +%Y%m%d)
```

**æ•°æ®æ¢å¤æ“ä½œ**

```bash
# åœæ­¢æœåŠ¡
systemctl stop prometheus

# æ¢å¤æ•°æ®ï¼ˆè°¨æ…æ“ä½œï¼‰
cp -r /backup/prometheus-data-20230101 /var/lib/prometheus/

# è®¾ç½®æ­£ç¡®æƒé™
chown -R prometheus:prometheus /var/lib/prometheus/

# å¯åŠ¨æœåŠ¡
systemctl start prometheus
```

### 8.3 æ•…éšœé¢„é˜²æªæ–½


**å»ºç«‹ç›‘æ§çš„ç›‘æ§**

```yaml
# ç›‘æ§Prometheusè‡ªèº«
- alert: PrometheusDown
  expr: up{job="prometheus"} == 0
  for: 1m
  labels:
    severity: critical
  annotations:
    summary: "PrometheusæœåŠ¡å™¨å®•æœº"

# ç›‘æ§é‡‡é›†ç›®æ ‡
- alert: InstanceDown
  expr: up == 0
  for: 5m
  labels:
    severity: warning
  annotations:
    summary: "{{ $labels.instance }} æ— æ³•è®¿é—®"
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ’æŸ¥æ€è·¯


```
ğŸ”¸ ç›‘æ§æ•…éšœæ’æŸ¥ï¼šåˆ†å±‚è¯Šæ–­ï¼Œä»ä¸‹å¾€ä¸Šæ£€æŸ¥
ğŸ”¸ æ—¥å¿—åˆ†æï¼šå–„ç”¨æ—¥å¿—æ–‡ä»¶ï¼Œå…³æ³¨ERRORå’ŒWARNçº§åˆ«
ğŸ”¸ é…ç½®éªŒè¯ï¼šä½¿ç”¨å·¥å…·éªŒè¯è¯­æ³•ï¼Œé¿å…äººå·¥æ£€æŸ¥é”™è¯¯
ğŸ”¸ ç½‘ç»œæ£€æŸ¥ï¼šç«¯å£ã€é˜²ç«å¢™ã€è¿é€šæ€§æ˜¯åŸºç¡€
ğŸ”¸ èµ„æºç›‘æ§ï¼šç›‘æ§ç³»ç»Ÿæœ¬èº«ä¹Ÿéœ€è¦è¢«ç›‘æ§
```

### 9.2 æ•…éšœæ’æŸ¥å·¥å…·ç®±


| å·¥å…·ç±»å‹ | **å·¥å…·åç§°** | **ä¸»è¦ç”¨é€”** |
|---------|------------|-------------|
| ğŸ”§ **é…ç½®éªŒè¯** | `promtool` | `éªŒè¯Prometheusé…ç½®å’Œè§„åˆ™` |
| ğŸ“ **æ—¥å¿—æŸ¥çœ‹** | `journalctl` | `æŸ¥çœ‹systemdæœåŠ¡æ—¥å¿—` |
| ğŸŒ **ç½‘ç»œæµ‹è¯•** | `curl/telnet` | `æµ‹è¯•HTTPæœåŠ¡å’Œç«¯å£è¿é€šæ€§` |
| ğŸ“Š **æ€§èƒ½åˆ†æ** | `top/htop` | `æŸ¥çœ‹è¿›ç¨‹èµ„æºä½¿ç”¨æƒ…å†µ` |
| ğŸ” **è°ƒè¯•å·¥å…·** | `amtool` | `Alertmanageré…ç½®å’ŒçŠ¶æ€æ£€æŸ¥` |

### 9.3 é¢„é˜²èƒœäºæ²»ç–—


**ğŸ”¹ å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»**
```
ç³»ç»Ÿç›‘æ§ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
åº”ç”¨ç›‘æ§ï¼šæœåŠ¡çŠ¶æ€ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡
ç›‘æ§çš„ç›‘æ§ï¼šç›‘æ§ç³»ç»Ÿæœ¬èº«çš„å¯ç”¨æ€§
```

**ğŸ”¹ åˆ¶å®šè¿ç»´è§„èŒƒ**
```
é…ç½®ç®¡ç†ï¼šç‰ˆæœ¬æ§åˆ¶ã€å˜æ›´è®°å½•
æ•…éšœå¤„ç†ï¼šåº”æ€¥é¢„æ¡ˆã€è”ç³»æ–¹å¼
æ–‡æ¡£ç»´æŠ¤ï¼šæ•…éšœæ‰‹å†Œã€ç»éªŒæ€»ç»“
```

**ğŸ”¹ å®šæœŸæ£€æŸ¥ä¸ä¼˜åŒ–**
```
æ€§èƒ½è¯„ä¼°ï¼šæŸ¥è¯¢æ•ˆç‡ã€å­˜å‚¨ä½¿ç”¨
è§„åˆ™å®¡æŸ¥ï¼šå‘Šè­¦é˜ˆå€¼ã€è§„åˆ™æœ‰æ•ˆæ€§
å®¹é‡è§„åˆ’ï¼šæ•°æ®å¢é•¿ã€ç¡¬ä»¶æ‰©å®¹
```

### 9.4 å®æˆ˜ç»éªŒæ€»ç»“


**æ•…éšœæ’æŸ¥é‡‘å­—å¡”**
```
                 ğŸ” æ·±å…¥åˆ†æ
               â†—     â†‘     â†–
          é…ç½®æ£€æŸ¥   æ—¥å¿—åˆ†æ   æ€§èƒ½è¯Šæ–­
         â†—    â†‘    â†—  â†‘  â†–    â†‘    â†–
    æœåŠ¡çŠ¶æ€ ç½‘ç»œè¿é€š æƒé™æ£€æŸ¥ èµ„æºä½¿ç”¨ æ•°æ®å®Œæ•´æ€§
```

**æ ¸å¿ƒè®°å¿†å£è¯€**
- é‡åˆ°é—®é¢˜å…ˆçœ‹æ—¥å¿—ï¼Œæ—¥å¿—ä¿¡æ¯æœ€å¯é 
- é…ç½®è¯­æ³•è¦éªŒè¯ï¼Œå·¥å…·æ£€æŸ¥æ¯”äººå¼º  
- ç½‘ç»œè¿é€šè¦ç¡®ä¿ï¼Œç«¯å£é˜²ç«å¢™æ£€æŸ¥å¥½
- èµ„æºä½¿ç”¨éœ€å…³æ³¨ï¼Œæ€§èƒ½ä¼˜åŒ–ä¸èƒ½å°‘
- å¤‡ä»½æ¢å¤è¦åšå¥½ï¼Œæœªé›¨ç»¸ç¼ªä¿å¹³å®‰

é€šè¿‡ç³»ç»ŸåŒ–çš„æ•…éšœæ’æŸ¥æ–¹æ³•å’Œé¢„é˜²æªæ–½ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹èµ·ç¨³å®šå¯é çš„ç›‘æ§ä½“ç³»ï¼Œç¡®ä¿èƒ½å¤ŸåŠæ—¶å‘ç°å’Œè§£å†³ç³»ç»Ÿé—®é¢˜ï¼Œä¸ºä¸šåŠ¡ç¨³å®šè¿è¡Œæä¾›æœ‰åŠ›ä¿éšœã€‚