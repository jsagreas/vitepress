---
title: 7ã€Alertmanagerå‘Šè­¦ç®¡ç†
---
## ğŸ“š ç›®å½•


1. [Alertmanageræ ¸å¿ƒæ¦‚å¿µ](#1-alertmanageræ ¸å¿ƒæ¦‚å¿µ)
2. [å®‰è£…é…ç½®å®è·µ](#2-å®‰è£…é…ç½®å®è·µ)
3. [å‘Šè­¦è·¯ç”±è§„åˆ™é…ç½®](#3-å‘Šè­¦è·¯ç”±è§„åˆ™é…ç½®)
4. [å‘Šè­¦åˆ†ç»„å’ŒæŠ‘åˆ¶æœºåˆ¶](#4-å‘Šè­¦åˆ†ç»„å’ŒæŠ‘åˆ¶æœºåˆ¶)
5. [é€šçŸ¥æ¸ é“é…ç½®è¯¦è§£](#5-é€šçŸ¥æ¸ é“é…ç½®è¯¦è§£)
6. [å‘Šè­¦é™é»˜å’Œå±è”½ç®¡ç†](#6-å‘Šè­¦é™é»˜å’Œå±è”½ç®¡ç†)
7. [å‘Šè­¦å‡çº§ç­–ç•¥](#7-å‘Šè­¦å‡çº§ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Alertmanageræ ¸å¿ƒæ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯Alertmanager



**ç®€å•ç†è§£**ï¼šAlertmanagerå°±åƒä¸€ä¸ªæ™ºèƒ½çš„"å‘Šè­¦ç®¡å®¶"ï¼Œä¸“é—¨è´Ÿè´£å¤„ç†Prometheuså‘é€è¿‡æ¥çš„å‘Šè­¦ä¿¡æ¯ã€‚

```
å‘Šè­¦å¤„ç†æµç¨‹ï¼š
Prometheusç›‘æ§ç³»ç»Ÿ â†’ å‘ç°å¼‚å¸¸ â†’ å‘é€å‘Šè­¦ â†’ Alertmanageræ¥æ”¶ â†’ æ™ºèƒ½å¤„ç† â†’ é€šçŸ¥ç›¸å…³äººå‘˜

æ¯”å¦‚ï¼š
æœåŠ¡å™¨CPUä½¿ç”¨ç‡è¶…è¿‡90% â†’ Prometheuså‘ç°é—®é¢˜ â†’ å‘Šè¯‰Alertmanager â†’ Alertmanagerå‘é‚®ä»¶/å¾®ä¿¡é€šçŸ¥è¿ç»´äººå‘˜
```

**ğŸ”¸ Alertmanagerçš„ä½œç”¨**
- **å‘Šè­¦å»é‡**ï¼šç›¸åŒçš„å‘Šè­¦ä¸ä¼šé‡å¤å‘é€
- **å‘Šè­¦åˆ†ç»„**ï¼šç›¸å…³å‘Šè­¦æ‰“åŒ…ä¸€èµ·å‘é€ï¼Œé¿å…ä¿¡æ¯è½°ç‚¸
- **å‘Šè­¦è·¯ç”±**ï¼šä¸åŒç±»å‹çš„å‘Šè­¦å‘ç»™ä¸åŒçš„äºº
- **å‘Šè­¦é™é»˜**ï¼šç»´æŠ¤æœŸé—´å¯ä»¥ä¸´æ—¶å…³é—­å‘Šè­¦
- **å‘Šè­¦æŠ‘åˆ¶**ï¼šä¸¥é‡å‘Šè­¦å‡ºç°æ—¶ï¼Œéšè—ç›¸å…³çš„æ¬¡è¦å‘Šè­¦

### 1.2 Alertmanageråœ¨ç›‘æ§ç³»ç»Ÿä¸­çš„ä½ç½®



```
ç›‘æ§æ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®é‡‡é›†   â”‚â”€â”€â”€â†’â”‚ Prometheus   â”‚â”€â”€â”€â†’â”‚Alertmanager â”‚â”€â”€â”€â†’â”‚   é€šçŸ¥æ¸ é“   â”‚
â”‚(Node Expo.) â”‚    â”‚   (è§„åˆ™å¼•æ“)  â”‚    â”‚  (å‘Šè­¦å¤„ç†)  â”‚    â”‚ (é‚®ä»¶/å¾®ä¿¡ç­‰) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                                      
                           â†“                                      
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              
                   â”‚   Grafana    â”‚                              
                   â”‚  (æ•°æ®å±•ç¤º)   â”‚                              
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              
```

### 1.3 å‘Šè­¦å¤„ç†çš„æ ¸å¿ƒç†å¿µ



**ğŸ”¸ å‘Šè­¦ä¸æ˜¯è¶Šå¤šè¶Šå¥½**
- **ç²¾å‡†å‘Šè­¦**ï¼šåªæŠ¥å‘ŠçœŸæ­£éœ€è¦äººå·¥å¤„ç†çš„é—®é¢˜
- **é¿å…å‘Šè­¦ç–²åŠ³**ï¼šè¿‡å¤šæ— æ„ä¹‰çš„å‘Šè­¦ä¼šè®©äººå¿½è§†çœŸæ­£çš„é—®é¢˜
- **åˆ†çº§å¤„ç†**ï¼šä¸åŒä¸¥é‡ç¨‹åº¦çš„å‘Šè­¦é‡‡ç”¨ä¸åŒçš„å¤„ç†ç­–ç•¥

**ğŸ”¸ å‘Šè­¦å¤„ç†çš„æ™ºèƒ½åŒ–**
```
åŸå§‹æ–¹å¼ï¼šæ¯ä¸ªé—®é¢˜éƒ½å•ç‹¬å‘å‘Šè­¦ â†’ ä¿¡æ¯è¿‡è½½
æ™ºèƒ½æ–¹å¼ï¼šç›¸å…³é—®é¢˜å½’å¹¶å¤„ç† â†’ æ¸…æ™°æ˜äº†

ä¸¾ä¾‹ï¼š
åŸå§‹ï¼šæ”¶åˆ°50ä¸ª"ç£ç›˜ç©ºé—´ä¸è¶³"çš„å‘Šè­¦
æ™ºèƒ½ï¼šæ”¶åˆ°1ä¸ª"5å°æœåŠ¡å™¨ç£ç›˜ç©ºé—´ä¸è¶³"çš„æ±‡æ€»å‘Šè­¦
```

---

## 2. ğŸ”§ å®‰è£…é…ç½®å®è·µ



### 2.1 Alertmanagerå®‰è£…



**æ–¹æ³•ä¸€ï¼šäºŒè¿›åˆ¶å®‰è£…ï¼ˆæ¨èæ–°æ‰‹ï¼‰**
```bash
# ä¸‹è½½Alertmanager

wget https://github.com/prometheus/alertmanager/releases/download/v0.25.0/alertmanager-0.25.0.linux-amd64.tar.gz

# è§£å‹å®‰è£…

tar -xzf alertmanager-0.25.0.linux-amd64.tar.gz
sudo mv alertmanager-0.25.0.linux-amd64 /opt/alertmanager

# åˆ›å»ºç”¨æˆ·

sudo useradd --no-create-home --shell /bin/false alertmanager

# è®¾ç½®æƒé™

sudo chown -R alertmanager:alertmanager /opt/alertmanager
```

**æ–¹æ³•äºŒï¼šDockerå®‰è£…ï¼ˆæ›´ç®€å•ï¼‰**
```bash
# æ‹‰å–é•œåƒ

docker pull prom/alertmanager:v0.25.0

# è¿è¡Œå®¹å™¨

docker run -d \
  --name alertmanager \
  -p 9093:9093 \
  -v /path/to/config:/etc/alertmanager \
  prom/alertmanager:v0.25.0
```

### 2.2 åŸºç¡€é…ç½®æ–‡ä»¶



**åˆ›å»ºé…ç½®æ–‡ä»¶ `/opt/alertmanager/alertmanager.yml`**
```yaml
# å…¨å±€é…ç½®

global:
#  # SMTPæœåŠ¡å™¨é…ç½®ï¼ˆç”¨äºå‘é‚®ä»¶ï¼‰
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'alertmanager@example.com'
  smtp_auth_password: 'password123'

# è·¯ç”±é…ç½®ï¼ˆå‘Šè­¦å¦‚ä½•åˆ†å‘ï¼‰

route:
  group_by: ['alertname']          # æŒ‰å‘Šè­¦åç§°åˆ†ç»„
  group_wait: 10s                  # åˆ†ç»„ç­‰å¾…æ—¶é—´
  group_interval: 10s              # åˆ†ç»„å‘é€é—´éš”
  repeat_interval: 1h              # é‡å¤å‘é€é—´éš”
  receiver: 'web.hook'             # é»˜è®¤æ¥æ”¶è€…

# æ¥æ”¶è€…é…ç½®ï¼ˆè°æ¥æ¥æ”¶å‘Šè­¦ï¼‰

receivers:
- name: 'web.hook'
  email_configs:
  - to: 'admin@example.com'
    subject: 'ã€å‘Šè­¦ã€‘{{ .GroupLabels.alertname }}'
    body: |
      å‘Šè­¦è¯¦æƒ…ï¼š
      {{ range .Alerts }}
      å‘Šè­¦åç§°ï¼š{{ .Annotations.summary }}
      è¯¦ç»†ä¿¡æ¯ï¼š{{ .Annotations.description }}
      {{ end }}
```

### 2.3 ç³»ç»ŸæœåŠ¡é…ç½®



**åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/alertmanager.service`**
```ini
[Unit]
Description=Alertmanager
After=network.target

[Service]
User=alertmanager
Group=alertmanager
Type=simple
ExecStart=/opt/alertmanager/alertmanager \
    --config.file=/opt/alertmanager/alertmanager.yml \
    --storage.path=/opt/alertmanager/data/
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

**å¯åŠ¨æœåŠ¡**
```bash
# é‡æ–°åŠ è½½systemdé…ç½®

sudo systemctl daemon-reload

# å¯åŠ¨Alertmanager

sudo systemctl start alertmanager

# è®¾ç½®å¼€æœºè‡ªå¯

sudo systemctl enable alertmanager

# æ£€æŸ¥çŠ¶æ€

sudo systemctl status alertmanager
```

---

## 3. ğŸ›£ï¸ å‘Šè­¦è·¯ç”±è§„åˆ™é…ç½®



### 3.1 è·¯ç”±è§„åˆ™åŸºæœ¬æ¦‚å¿µ



**ä»€ä¹ˆæ˜¯å‘Šè­¦è·¯ç”±ï¼Ÿ**
ç®€å•è¯´å°±æ˜¯"ä»€ä¹ˆæ ·çš„å‘Šè­¦å‘ç»™ä»€ä¹ˆäºº"ã€‚å°±åƒé‚®å±€åˆ†æ‹£é‚®ä»¶ä¸€æ ·ï¼Œä¸åŒçš„å‘Šè­¦è¦å‘ç»™ä¸åŒçš„è´Ÿè´£äººã€‚

```
è·¯ç”±è§„åˆ™ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    è·¯ç”±è§„åˆ™     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®åº“å‘Šè­¦  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚ æ•°æ®åº“å›¢é˜Ÿ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç½‘ç»œå‘Šè­¦    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚ ç½‘ç»œå›¢é˜Ÿ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨å‘Šè­¦    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚ å¼€å‘å›¢é˜Ÿ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 è·¯ç”±é…ç½®è¯¦è§£



**å®Œæ•´çš„è·¯ç”±é…ç½®ç¤ºä¾‹**
```yaml
route:
#  # é»˜è®¤åˆ†ç»„æ–¹å¼
  group_by: ['alertname', 'cluster', 'service']
  
#  # æ—¶é—´é…ç½®
  group_wait: 30s        # æ”¶åˆ°å‘Šè­¦åç­‰å¾…30ç§’ï¼Œçœ‹æ˜¯å¦æœ‰æ›´å¤šç›¸å…³å‘Šè­¦
  group_interval: 5m     # åŒä¸€ç»„å‘Šè­¦æ¯5åˆ†é’Ÿæœ€å¤šå‘é€ä¸€æ¬¡
  repeat_interval: 4h    # åŒæ ·çš„å‘Šè­¦4å°æ—¶åæ‰é‡å¤å‘é€
  
#  # é»˜è®¤æ¥æ”¶è€…
  receiver: 'default-receiver'
  
#  # å­è·¯ç”±è§„åˆ™
  routes:
#  # æ•°æ®åº“å‘Šè­¦è·¯ç”±
  - match:
      service: mysql
    receiver: database-team
    group_wait: 10s
    
#  # ä¸¥é‡å‘Šè­¦è·¯ç”±
  - match:
      severity: critical
    receiver: oncall-engineer
    group_wait: 0s         # ä¸¥é‡å‘Šè­¦ç«‹å³å‘é€
    
#  # å¼€å‘ç¯å¢ƒå‘Šè­¦è·¯ç”±
  - match:
      environment: dev
    receiver: dev-team
    group_interval: 1h     # å¼€å‘ç¯å¢ƒå‘Šè­¦é¢‘ç‡å¯ä»¥ä½ä¸€äº›
```

### 3.3 åŒ¹é…è§„åˆ™è¯¦è§£



**ğŸ”¸ ç²¾ç¡®åŒ¹é…**
```yaml
# å®Œå…¨åŒ¹é…æ ‡ç­¾å€¼

- match:
    alertname: HighCPUUsage
    instance: server-01
```

**ğŸ”¸ æ­£åˆ™åŒ¹é…**
```yaml
# ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

- match_re:
    instance: 'server-0[1-3]'    # åŒ¹é…server-01, server-02, server-03
    service: '(mysql|postgres)'   # åŒ¹é…mysqlæˆ–postgres
```

**ğŸ”¸ å¤šæ¡ä»¶åŒ¹é…**
```yaml
# åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶

- match:
    severity: critical
    team: backend
  match_re:
    instance: 'prod-.*'
```

### 3.4 è·¯ç”±ä¼˜å…ˆçº§



**è·¯ç”±åŒ¹é…çš„ä¼˜å…ˆçº§åŸåˆ™**ï¼š
- **ä»ä¸Šåˆ°ä¸‹**ï¼šæŒ‰é…ç½®æ–‡ä»¶ä¸­çš„é¡ºåºåŒ¹é…
- **ç¬¬ä¸€åŒ¹é…**ï¼šåŒ¹é…åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„è·¯ç”±å°±ä½¿ç”¨
- **é»˜è®¤è·¯ç”±**ï¼šå¦‚æœéƒ½ä¸åŒ¹é…ï¼Œä½¿ç”¨é»˜è®¤çš„receiver

```yaml
routes:
# 1. æœ€é«˜ä¼˜å…ˆçº§ï¼šç´§æ€¥å‘Šè­¦

- match:
    severity: critical
  receiver: emergency-team
  
# 2. ä¸­ç­‰ä¼˜å…ˆçº§ï¼šç”Ÿäº§ç¯å¢ƒå‘Šè­¦

- match:
    environment: production
  receiver: prod-team
  
# 3. è¾ƒä½ä¼˜å…ˆçº§ï¼šå¼€å‘ç¯å¢ƒå‘Šè­¦

- match:
    environment: development
  receiver: dev-team
  
# 4. é»˜è®¤è·¯ç”±åœ¨routeçš„é¡¶å±‚é…ç½®ä¸­

```

---

## 4. ğŸ“¦ å‘Šè­¦åˆ†ç»„å’ŒæŠ‘åˆ¶æœºåˆ¶



### 4.1 å‘Šè­¦åˆ†ç»„æœºåˆ¶



**ä¸ºä»€ä¹ˆéœ€è¦å‘Šè­¦åˆ†ç»„ï¼Ÿ**
æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨å®•æœºäº†ï¼Œå¯èƒ½åŒæ—¶äº§ç”Ÿ"CPUå‘Šè­¦"ã€"å†…å­˜å‘Šè­¦"ã€"ç£ç›˜å‘Šè­¦"ã€"ç½‘ç»œå‘Šè­¦"ç­‰å¤šä¸ªå‘Šè­¦ã€‚å¦‚æœæ¯ä¸ªéƒ½å•ç‹¬å‘é€ï¼Œä½ ä¼šè¢«å‘Šè­¦ä¿¡æ¯æ·¹æ²¡ã€‚

**ğŸ”¸ åˆ†ç»„ç­–ç•¥é…ç½®**
```yaml
route:
#  # æŒ‰å¤šä¸ªæ ‡ç­¾ç»„åˆåˆ†ç»„
  group_by: ['alertname', 'cluster', 'service']
  
#  # åˆ†ç»„æ—¶é—´é…ç½®
  group_wait: 30s        # ç­‰å¾…30ç§’æ”¶é›†ç›¸å…³å‘Šè­¦
  group_interval: 5m     # åŒä¸€ç»„å‘Šè­¦æœ€å¤š5åˆ†é’Ÿå‘é€ä¸€æ¬¡
  repeat_interval: 4h    # ç›¸åŒå†…å®¹4å°æ—¶åæ‰é‡å¤å‘é€
```

**ğŸ”¸ åˆ†ç»„æ•ˆæœå¯¹æ¯”**
```
ä¸åˆ†ç»„çš„æƒ…å†µï¼š
ğŸ“§ å‘Šè­¦1ï¼šserver-01 CPUä½¿ç”¨ç‡è¿‡é«˜
ğŸ“§ å‘Šè­¦2ï¼šserver-01 å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜  
ğŸ“§ å‘Šè­¦3ï¼šserver-01 ç£ç›˜ç©ºé—´ä¸è¶³
ğŸ“§ å‘Šè­¦4ï¼šserver-02 CPUä½¿ç”¨ç‡è¿‡é«˜
... (æ”¶åˆ°20å°é‚®ä»¶)

åˆ†ç»„åçš„æƒ…å†µï¼š
ğŸ“§ å‘Šè­¦æ±‡æ€»ï¼šé›†ç¾¤cluster-01å‘ç”Ÿ4ç±»å‘Šè­¦ï¼Œæ¶‰åŠ3å°æœåŠ¡å™¨
   - CPUå‘Šè­¦ï¼šserver-01, server-02
   - å†…å­˜å‘Šè­¦ï¼šserver-01
   - ç£ç›˜å‘Šè­¦ï¼šserver-01, server-03
```

### 4.2 å‘Šè­¦æŠ‘åˆ¶æœºåˆ¶



**ä»€ä¹ˆæ˜¯å‘Šè­¦æŠ‘åˆ¶ï¼Ÿ**
å½“å‘ç”Ÿä¸¥é‡é—®é¢˜æ—¶ï¼Œç›¸å…³çš„æ¬¡è¦é—®é¢˜å‘Šè­¦ä¼šè¢«è‡ªåŠ¨æŠ‘åˆ¶ï¼Œé¿å…ä¿¡æ¯å¹²æ‰°ã€‚

**ğŸ”¸ æŠ‘åˆ¶è§„åˆ™é…ç½®**
```yaml
# æŠ‘åˆ¶è§„åˆ™é…ç½®

inhibit_rules:
# èŠ‚ç‚¹å®•æœºæ—¶ï¼ŒæŠ‘åˆ¶è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰å…¶ä»–å‘Šè­¦

- source_match:
    alertname: NodeDown           # æºå‘Šè­¦ï¼šèŠ‚ç‚¹å®•æœº
  target_match:
    alertname: HighCPUUsage      # ç›®æ ‡å‘Šè­¦ï¼šCPUä½¿ç”¨ç‡é«˜
  equal: ['instance']            # å½“instanceæ ‡ç­¾ç›¸åŒæ—¶ç”Ÿæ•ˆ

# é›†ç¾¤æ•…éšœæ—¶ï¼ŒæŠ‘åˆ¶å•ä¸ªæœåŠ¡å‘Šè­¦  

- source_match:
    severity: critical
    alertname: ClusterDown
  target_match_re:
    alertname: '(HighMemory|DiskFull).*'
  equal: ['cluster']
```

**ğŸ”¸ æŠ‘åˆ¶æœºåˆ¶å·¥ä½œåŸç†**
```
æŠ‘åˆ¶åœºæ™¯ç¤ºä¾‹ï¼š
1. æœåŠ¡å™¨server-01ç½‘çº¿è¢«æ‹”æ‰ï¼ˆNodeDownå‘Šè­¦ï¼‰
2. åŒæ—¶ä¼šäº§ç”ŸCPUã€å†…å­˜ç­‰ç›‘æ§è¶…æ—¶å‘Šè­¦
3. æŠ‘åˆ¶è§„åˆ™ç”Ÿæ•ˆï¼šåªå‘é€NodeDownå‘Šè­¦ï¼Œå…¶ä»–å‘Šè­¦è¢«æŠ‘åˆ¶
4. ç½‘çº¿æ¢å¤åï¼šæŠ‘åˆ¶è§£é™¤ï¼Œå¦‚æœè¿˜æœ‰å…¶ä»–é—®é¢˜ä¼šæ­£å¸¸å‘Šè­¦

å¥½å¤„ï¼š
âœ… é¿å…å‘Šè­¦é£æš´
âœ… çªå‡ºä¸»è¦é—®é¢˜  
âœ… å‡å°‘å¹²æ‰°ä¿¡æ¯
```

### 4.3 é™é»˜è§„åˆ™é…ç½®



**ä»€ä¹ˆæ˜¯é™é»˜ï¼Ÿ**
åœ¨ç³»ç»Ÿç»´æŠ¤æœŸé—´ï¼Œä¸´æ—¶å…³é—­æŸäº›å‘Šè­¦ï¼Œé¿å…ç»´æŠ¤æ“ä½œè§¦å‘ä¸å¿…è¦çš„å‘Šè­¦é€šçŸ¥ã€‚

**ğŸ”¸ é€šè¿‡Webç•Œé¢è®¾ç½®é™é»˜**
```
æ“ä½œæ­¥éª¤ï¼š
1. è®¿é—® http://alertmanager:9093
2. ç‚¹å‡»"Silences"æ ‡ç­¾
3. ç‚¹å‡»"New Silence"
4. è®¾ç½®åŒ¹é…æ¡ä»¶å’Œé™é»˜æ—¶é—´
5. æ·»åŠ æ³¨é‡Šè¯´æ˜åŸå› 
```

**ğŸ”¸ é€šè¿‡APIè®¾ç½®é™é»˜**
```bash
# ä¸ºç‰¹å®šæœåŠ¡å™¨è®¾ç½®2å°æ—¶é™é»˜

curl -X POST http://localhost:9093/api/v1/silences \
-H "Content-Type: application/json" \
-d '{
  "matchers": [
    {
      "name": "instance",
      "value": "server-01:9100",
      "isRegex": false
    }
  ],
  "startsAt": "2023-09-17T10:00:00.000Z",
  "endsAt": "2023-09-17T12:00:00.000Z",
  "comment": "æœåŠ¡å™¨ç»´æŠ¤ï¼Œæš‚æ—¶é™é»˜å‘Šè­¦",
  "createdBy": "admin"
}'
```

---

## 5. ğŸ“¢ é€šçŸ¥æ¸ é“é…ç½®è¯¦è§£



### 5.1 é‚®ä»¶é€šçŸ¥é…ç½®



**åŸºç¡€é‚®ä»¶é…ç½®**
```yaml
global:
#  # SMTPæœåŠ¡å™¨é…ç½®
  smtp_smarthost: 'smtp.qq.com:587'
  smtp_from: 'monitor@company.com'
  smtp_auth_username: 'monitor@company.com'
  smtp_auth_password: 'your-app-password'
  smtp_require_tls: true

receivers:
- name: 'email-notifications'
  email_configs:
  - to: 'team@company.com'
    subject: 'ğŸš¨ã€{{ .Status | toUpper }}ã€‘{{ .GroupLabels.alertname }}'
    html: |
      <h2>å‘Šè­¦é€šçŸ¥</h2>
      <p><strong>çŠ¶æ€ï¼š</strong>{{ .Status }}</p>
      <p><strong>æ—¶é—´ï¼š</strong>{{ .CommonAnnotations.timestamp }}</p>
      
      <h3>å‘Šè­¦è¯¦æƒ…ï¼š</h3>
      <ul>
      {{ range .Alerts }}
      <li>
        <strong>{{ .Annotations.summary }}</strong><br>
        æè¿°ï¼š{{ .Annotations.description }}<br>
        å®ä¾‹ï¼š{{ .Labels.instance }}<br>
      </li>
      {{ end }}
      </ul>
```

**ğŸ“§ é‚®ä»¶æ¨¡æ¿ä¼˜åŒ–**
```yaml
# è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿

email_configs:
- to: 'ops-team@company.com'
  subject: |
    {{ if eq .Status "firing" }}ğŸ”¥ å‘Šè­¦è§¦å‘{{ else }}âœ… å‘Šè­¦æ¢å¤{{ end }} - {{ .GroupLabels.alertname }}
  
  html: |
    <!DOCTYPE html>
    <html>
    <head>
        <style>
            .alert-firing { background-color: #ffebee; border-left: 4px solid #f44336; }
            .alert-resolved { background-color: #e8f5e8; border-left: 4px solid #4caf50; }
            .alert-item { margin: 10px 0; padding: 10px; }
        </style>
    </head>
    <body>
        <h2>{{ .CommonLabels.alertname }} å‘Šè­¦é€šçŸ¥</h2>
        
        {{ range .Alerts }}
        <div class="alert-item {{ if eq .Status "firing" }}alert-firing{{ else }}alert-resolved{{ end }}">
            <h3>{{ .Annotations.summary }}</h3>
            <p><strong>çŠ¶æ€ï¼š</strong>{{ .Status }}</p>
            <p><strong>å®ä¾‹ï¼š</strong>{{ .Labels.instance }}</p>
            <p><strong>æè¿°ï¼š</strong>{{ .Annotations.description }}</p>
            <p><strong>å¼€å§‹æ—¶é—´ï¼š</strong>{{ .StartsAt.Format "2006-01-02 15:04:05" }}</p>
        </div>
        {{ end }}
    </body>
    </html>
```

### 5.2 Webhooké›†æˆé…ç½®



**ä»€ä¹ˆæ˜¯Webhookï¼Ÿ**
Webhookå°±åƒä¸€ä¸ª"ä¿¡ä½¿"ï¼Œå½“æœ‰å‘Šè­¦æ—¶ï¼ŒAlertmanagerä¼šè‡ªåŠ¨å‘é€HTTPè¯·æ±‚åˆ°æŒ‡å®šçš„ç½‘å€ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªæ¥é›†æˆå„ç§é€šçŸ¥ç³»ç»Ÿã€‚

**ğŸ”¸ åŸºç¡€Webhooké…ç½®**
```yaml
receivers:
- name: 'webhook-notifications'
  webhook_configs:
  - url: 'http://your-webhook-server:8080/alerts'
    send_resolved: true                    # å‘Šè­¦æ¢å¤æ—¶ä¹Ÿå‘é€
    http_config:
      bearer_token: 'your-secret-token'   # è®¤è¯token
    max_alerts: 10                        # æ¯æ¬¡æœ€å¤šå‘é€10ä¸ªå‘Šè­¦
```

**ğŸ”¸ ä¼ä¸šå¾®ä¿¡æœºå™¨äººé›†æˆ**
```yaml
receivers:
- name: 'wechat-bot'
  webhook_configs:
  - url: 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_BOT_KEY'
    send_resolved: true
    http_config:
      headers:
        Content-Type: application/json
#    # ä¼ä¸šå¾®ä¿¡éœ€è¦ç‰¹å®šçš„JSONæ ¼å¼
    title: 'å‘Šè­¦é€šçŸ¥'
    text: |
      {{ range .Alerts }}
      **{{ .Annotations.summary }}**
      æè¿°ï¼š{{ .Annotations.description }}
      å®ä¾‹ï¼š{{ .Labels.instance }}
      çŠ¶æ€ï¼š{{ .Status }}
      {{ end }}
```

**ğŸ”¸ é’‰é’‰æœºå™¨äººé›†æˆ**
```yaml
receivers:
- name: 'dingtalk-bot'  
  webhook_configs:
  - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN'
    send_resolved: true
    http_config:
      headers:
        Content-Type: application/json
#    # é’‰é’‰markdownæ ¼å¼
    title: 'Prometheuså‘Šè­¦'
    text: |
#      ## {{ .GroupLabels.alertname }}å‘Šè­¦
      
      {{ range .Alerts }}
#      ### {{ .Annotations.summary }}
      - **å®ä¾‹**: {{ .Labels.instance }}  
      - **æè¿°**: {{ .Annotations.description }}
      - **çŠ¶æ€**: {{ .Status }}
      - **æ—¶é—´**: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
      {{ end }}
```

### 5.3 çŸ­ä¿¡å’Œç”µè¯å‘Šè­¦



**PagerDutyé›†æˆ**
```yaml
receivers:
- name: 'pagerduty-critical'
  pagerduty_configs:
  - service_key: 'YOUR_PAGERDUTY_SERVICE_KEY'
    description: '{{ .CommonAnnotations.summary }}'
    details:
      firing: '{{ .Alerts.Firing | len }}'
      resolved: '{{ .Alerts.Resolved | len }}'
      alertname: '{{ .GroupLabels.alertname }}'
```

**è‡ªå®šä¹‰çŸ­ä¿¡æœåŠ¡**
```yaml
receivers:
- name: 'sms-alerts'
  webhook_configs:
  - url: 'http://your-sms-service/send'
    http_config:
      headers:
        Authorization: 'Bearer YOUR_SMS_TOKEN'
    title: 'SMS Alert'
    text: |
      å‘Šè­¦:{{ .GroupLabels.alertname }}
      {{ range .Alerts }}
      {{ .Annotations.summary }}
      {{ end }}
```

---

## 6. ğŸ”‡ å‘Šè­¦é™é»˜å’Œå±è”½ç®¡ç†



### 6.1 é™é»˜ç®¡ç†åŸºç¡€



**ä»€ä¹ˆæ—¶å€™éœ€è¦é™é»˜ï¼Ÿ**
- **è®¡åˆ’ç»´æŠ¤**ï¼šæœåŠ¡å™¨é‡å¯ã€è½¯ä»¶å‡çº§
- **å·²çŸ¥é—®é¢˜**ï¼šæ­£åœ¨ä¿®å¤çš„é—®é¢˜ï¼Œæš‚æ—¶ä¸éœ€è¦é‡å¤æé†’
- **æµ‹è¯•ç¯å¢ƒ**ï¼šå¼€å‘æµ‹è¯•æ—¶é¿å…å‘Šè­¦å¹²æ‰°

**ğŸ”¸ é™é»˜çš„ç±»å‹**
```
æ—¶é—´é™é»˜ï¼šåœ¨ç‰¹å®šæ—¶é—´æ®µå†…å±è”½å‘Šè­¦
æ¡ä»¶é™é»˜ï¼šæ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å‘Šè­¦è¢«å±è”½
å…¨å±€é™é»˜ï¼šæ‰€æœ‰å‘Šè­¦éƒ½è¢«å±è”½ï¼ˆç´§æ€¥æƒ…å†µä½¿ç”¨ï¼‰
```

### 6.2 Webç•Œé¢é™é»˜ç®¡ç†



**é€šè¿‡æµè§ˆå™¨ç®¡ç†é™é»˜**
```
è®¿é—®æ­¥éª¤ï¼š
1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® http://alertmanager-ip:9093
2. ç‚¹å‡»é¡¶éƒ¨çš„ "Silences" æ ‡ç­¾
3. æŸ¥çœ‹å½“å‰çš„é™é»˜è§„åˆ™åˆ—è¡¨
4. ç‚¹å‡» "New Silence" åˆ›å»ºæ–°çš„é™é»˜è§„åˆ™

é™é»˜è§„åˆ™é…ç½®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Matchers (åŒ¹é…æ¡ä»¶)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ alertname = HighCPUUsage           â”‚
â”‚ instance = server-01:9100          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Start Time: 2023-09-17 10:00       â”‚
â”‚ End Time:   2023-09-17 12:00       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ Comment: æœåŠ¡å™¨ç»´æŠ¤æœŸé—´             â”‚
â”‚ Created by: admin                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 å‘½ä»¤è¡Œé™é»˜ç®¡ç†



**ä½¿ç”¨amtoolå‘½ä»¤è¡Œå·¥å…·**
```bash
# å®‰è£…amtool

wget https://github.com/prometheus/alertmanager/releases/download/v0.25.0/alertmanager-0.25.0.linux-amd64.tar.gz
tar -xzf alertmanager-0.25.0.linux-amd64.tar.gz
sudo cp alertmanager-0.25.0.linux-amd64/amtool /usr/local/bin/

# é…ç½®amtool

export ALERTMANAGER_URL=http://localhost:9093

# æŸ¥çœ‹å½“å‰é™é»˜

amtool silence query

# åˆ›å»ºé™é»˜ï¼ˆ2å°æ—¶ï¼‰

amtool silence add alertname=HighCPUUsage instance=server-01:9100 \
    --duration=2h \
    --comment="æœåŠ¡å™¨ç»´æŠ¤" \
    --author="admin"

# åˆ é™¤é™é»˜

amtool silence expire <silence-id>
```

### 6.4 é«˜çº§é™é»˜ç­–ç•¥



**ğŸ”¸ åŸºäºæ—¶é—´çš„è‡ªåŠ¨é™é»˜**
```yaml
# åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å·¥ä½œæ—¶é—´å¤–çš„é™é»˜

routes:
- match:
    severity: warning
  receiver: 'dev-team'
#  # å·¥ä½œæ—¶é—´å¤–é™ä½å‘Šè­¦é¢‘ç‡
  routes:
  - match:
      hour: '[0-8,18-23]'  # éå·¥ä½œæ—¶é—´
    group_interval: 2h     # å»¶é•¿å‘Šè­¦é—´éš”
```

**ğŸ”¸ æ¸è¿›å¼é™é»˜**
```bash
# è„šæœ¬ç¤ºä¾‹ï¼šé€æ­¥å¢åŠ é™é»˜æ—¶é—´

#!/bin/bash


ALERT_NAME="$1"
INSTANCE="$2"

# ç¬¬ä¸€æ¬¡é™é»˜30åˆ†é’Ÿ

amtool silence add alertname="$ALERT_NAME" instance="$INSTANCE" \
    --duration=30m --comment="åˆæ¬¡é™é»˜"

# å¦‚æœé—®é¢˜æŒç»­ï¼Œå¯ä»¥å»¶é•¿é™é»˜æ—¶é—´

sleep 1800  # ç­‰å¾…30åˆ†é’Ÿ
if [ "$(amtool alert query alertname="$ALERT_NAME" instance="$INSTANCE" | wc -l)" -gt 0 ]; then
    amtool silence add alertname="$ALERT_NAME" instance="$INSTANCE" \
        --duration=2h --comment="é—®é¢˜æŒç»­ï¼Œå»¶é•¿é™é»˜"
fi
```

---

## 7. ğŸ“ˆ å‘Šè­¦å‡çº§ç­–ç•¥



### 7.1 å‘Šè­¦å‡çº§åŸºæœ¬æ¦‚å¿µ



**ä»€ä¹ˆæ˜¯å‘Šè­¦å‡çº§ï¼Ÿ**
å°±åƒå…¬å¸çš„é—®é¢˜å‡çº§æµç¨‹ä¸€æ ·ï¼šæ™®é€šé—®é¢˜å…ˆæ‰¾ç›´æ¥è´Ÿè´£äººï¼Œå¦‚æœè§£å†³ä¸äº†å†æ‰¾ä¸»ç®¡ï¼Œæœ€åæ‰¾è€æ¿ã€‚

```
å‘Šè­¦å‡çº§æµç¨‹ï¼š
ç¬¬1çº§ï¼šä¸€èˆ¬å‘Šè­¦ â†’ å‘ç»™å€¼ç­å·¥ç¨‹å¸ˆ
ç¬¬2çº§ï¼šæŒç»­30åˆ†é’Ÿæœªè§£å†³ â†’ å‘ç»™å›¢é˜Ÿè´Ÿè´£äºº  
ç¬¬3çº§ï¼šæŒç»­1å°æ—¶æœªè§£å†³ â†’ å‘ç»™æŠ€æœ¯æ€»ç›‘
ç¬¬4çº§ï¼šæŒç»­2å°æ—¶æœªè§£å†³ â†’ å‘ç»™CTO
```

### 7.2 åŸºäºæ—¶é—´çš„å‡çº§ç­–ç•¥



**ğŸ”¸ å¤šçº§è·¯ç”±é…ç½®**
```yaml
route:
  receiver: 'default'
  routes:
#  # ç¬¬ä¸€çº§ï¼šåˆå§‹å‘Šè­¦
  - match:
      severity: critical
    receiver: 'oncall-engineer'
    group_wait: 0s
    repeat_interval: 15m
    
    routes:
#    # ç¬¬äºŒçº§ï¼š15åˆ†é’Ÿåå‡çº§
    - match:
        severity: critical
      receiver: 'team-lead'
      repeat_interval: 30m
      
      routes:
#      # ç¬¬ä¸‰çº§ï¼š45åˆ†é’Ÿåå†æ¬¡å‡çº§
      - match:
          severity: critical
        receiver: 'tech-director'
        repeat_interval: 1h

receivers:
- name: 'oncall-engineer'
  email_configs:
  - to: 'oncall@company.com'
    subject: 'ğŸ”¥ ç´§æ€¥å‘Šè­¦ - éœ€è¦ç«‹å³å¤„ç†'
    
- name: 'team-lead'
  email_configs:
  - to: 'teamlead@company.com'
    subject: 'âš ï¸ å‘Šè­¦å‡çº§ - é—®é¢˜æœªè§£å†³'
    
- name: 'tech-director'
  email_configs:
  - to: 'director@company.com'
    subject: 'ğŸš¨ é«˜çº§å‡çº§ - ä¸¥é‡é—®é¢˜æŒç»­'
```

### 7.3 æ™ºèƒ½å‡çº§ç­–ç•¥



**ğŸ”¸ åŸºäºå‘Šè­¦æ•°é‡çš„å‡çº§**
```yaml
# å½“åŒç±»å‘Šè­¦è¶…è¿‡é˜ˆå€¼æ—¶è‡ªåŠ¨å‡çº§

route:
  routes:
  - match:
      alertname: HighCPUUsage
    receiver: 'normal-alerts'
    
#    # å½“CPUå‘Šè­¦æ•°é‡è¾ƒå¤šæ—¶å‡çº§
    routes:
    - match:
        alertname: HighCPUUsage
      receiver: 'escalated-alerts'
#      # è¿™é‡Œå¯ä»¥é€šè¿‡å¤–éƒ¨è„šæœ¬åˆ¤æ–­å‘Šè­¦æ•°é‡
      continue: true  # ç»§ç»­åŒ¹é…å…¶ä»–è·¯ç”±
```

**ğŸ”¸ åŸºäºä¸šåŠ¡å½±å“çš„å‡çº§**
```yaml
route:
  routes:
#  # æ ¸å¿ƒä¸šåŠ¡å‘Šè­¦ç«‹å³å‡çº§
  - match:
      service: payment-service
      severity: critical
    receiver: 'immediate-escalation'
    group_wait: 0s
    
#  # ä¸€èˆ¬ä¸šåŠ¡å‘Šè­¦æ­£å¸¸æµç¨‹
  - match:
      severity: critical
    receiver: 'normal-critical'
    group_wait: 30s
```

### 7.4 å¤–éƒ¨å‡çº§ç³»ç»Ÿé›†æˆ



**ğŸ”¸ PagerDutyå‡çº§é…ç½®**
```yaml
receivers:
- name: 'pagerduty-escalation'
  pagerduty_configs:
  - service_key: 'PRIMARY_SERVICE_KEY'
    description: '{{ .CommonAnnotations.summary }}'
#    # PagerDutyä¼šæ ¹æ®å…¶å†…éƒ¨è§„åˆ™è‡ªåŠ¨å‡çº§
    
  - service_key: 'ESCALATION_SERVICE_KEY'  
    description: 'å‡çº§å‘Šè­¦: {{ .CommonAnnotations.summary }}'
#    # è¿™æ˜¯å‡çº§åçš„æœåŠ¡key
```

**ğŸ”¸ è‡ªå®šä¹‰å‡çº§è„šæœ¬**
```bash
#!/bin/bash

# escalation-webhook.sh


WEBHOOK_URL="$1"
ALERT_DATA="$2"

# è§£æå‘Šè­¦æ•°æ®

ALERT_NAME=$(echo "$ALERT_DATA" | jq -r '.groupLabels.alertname')
INSTANCE=$(echo "$ALERT_DATA" | jq -r '.commonLabels.instance')

# æ£€æŸ¥å‘Šè­¦æŒç»­æ—¶é—´

START_TIME=$(echo "$ALERT_DATA" | jq -r '.alerts[0].startsAt')
CURRENT_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

# è®¡ç®—æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰

DURATION=$(( $(date -d "$CURRENT_TIME" +%s) - $(date -d "$START_TIME" +%s) ))

# æ ¹æ®æŒç»­æ—¶é—´å†³å®šå‡çº§ç­–ç•¥

if [ $DURATION -gt 3600 ]; then  # è¶…è¿‡1å°æ—¶
#    # å‘é€ç»™é«˜çº§ç®¡ç†å±‚
    curl -X POST "$WEBHOOK_URL/escalate/high" -d "$ALERT_DATA"
elif [ $DURATION -gt 1800 ]; then  # è¶…è¿‡30åˆ†é’Ÿ
#    # å‘é€ç»™å›¢é˜Ÿè´Ÿè´£äºº
    curl -X POST "$WEBHOOK_URL/escalate/medium" -d "$ALERT_DATA"
else
#    # å‘é€ç»™å€¼ç­äººå‘˜
    curl -X POST "$WEBHOOK_URL/escalate/low" -d "$ALERT_DATA"
fi
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ Alertmanagerä½œç”¨ï¼šæ™ºèƒ½å¤„ç†Prometheuså‘Šè­¦ï¼Œé¿å…ä¿¡æ¯è¿‡è½½
ğŸ”¸ å‘Šè­¦è·¯ç”±ï¼šæ ¹æ®æ ‡ç­¾å°†ä¸åŒå‘Šè­¦å‘ç»™ä¸åŒçš„äºº
ğŸ”¸ å‘Šè­¦åˆ†ç»„ï¼šç›¸å…³å‘Šè­¦åˆå¹¶å‘é€ï¼Œå‡å°‘å¹²æ‰°
ğŸ”¸ å‘Šè­¦æŠ‘åˆ¶ï¼šä¸¥é‡é—®é¢˜å‘ç”Ÿæ—¶éšè—æ¬¡è¦å‘Šè­¦
ğŸ”¸ å‘Šè­¦é™é»˜ï¼šç»´æŠ¤æœŸé—´ä¸´æ—¶å±è”½å‘Šè­¦
ğŸ”¸ å‘Šè­¦å‡çº§ï¼šé—®é¢˜æŒç»­æœªè§£å†³æ—¶é€çº§ä¸ŠæŠ¥
```

### 8.2 å…³é”®é…ç½®ç†è§£è¦ç‚¹



**ğŸ”¹ é…ç½®æ–‡ä»¶ç»“æ„**
```
alertmanager.ymlç»“æ„ï¼š
global:        # å…¨å±€é…ç½®ï¼ˆé‚®ä»¶æœåŠ¡å™¨ç­‰ï¼‰
route:         # è·¯ç”±è§„åˆ™ï¼ˆå‘Šè­¦å¦‚ä½•åˆ†å‘ï¼‰
receivers:     # æ¥æ”¶è€…é…ç½®ï¼ˆå‘ç»™è°ï¼‰
inhibit_rules: # æŠ‘åˆ¶è§„åˆ™ï¼ˆä»€ä¹ˆæƒ…å†µä¸‹ä¸å‘ï¼‰
```

**ğŸ”¹ æ—¶é—´å‚æ•°å«ä¹‰**
```
group_wait: 30s        # ç­‰å¾…30ç§’æ”¶é›†ç›¸å…³å‘Šè­¦å†å‘é€
group_interval: 5m     # åŒä¸€ç»„å‘Šè­¦æœ€å¤š5åˆ†é’Ÿå‘é€ä¸€æ¬¡  
repeat_interval: 4h    # ç›¸åŒå‘Šè­¦4å°æ—¶åæ‰é‡å¤å‘é€
```

**ğŸ”¹ è·¯ç”±åŒ¹é…åŸåˆ™**
```
åŒ¹é…åŸåˆ™ï¼šä»ä¸Šåˆ°ä¸‹ï¼Œç¬¬ä¸€åŒ¹é…
ä¼˜å…ˆçº§ï¼šexact match > regex match > default
å»ºè®®ï¼šä¸¥é‡å‘Šè­¦æ”¾åœ¨é…ç½®æ–‡ä»¶å‰é¢
```

### 8.3 å®é™…åº”ç”¨åœºæ™¯



**ğŸ”¸ å°å›¢é˜Ÿé…ç½®ç­–ç•¥**
```
è·¯ç”±ç­–ç•¥ï¼š
- å·¥ä½œæ—¶é—´ï¼šå‘é‚®ä»¶+å¾®ä¿¡
- éå·¥ä½œæ—¶é—´ï¼šåªå‘å¾®ä¿¡ï¼Œé™ä½é¢‘ç‡  
- ä¸¥é‡å‘Šè­¦ï¼šç«‹å³å‘é€ï¼Œç”µè¯é€šçŸ¥
- ä¸€èˆ¬å‘Šè­¦ï¼š30åˆ†é’Ÿå†…åˆå¹¶å‘é€
```

**ğŸ”¸ å¤§ä¼ä¸šé…ç½®ç­–ç•¥**
```
åˆ†å±‚è·¯ç”±ï¼š
- æŒ‰ä¸šåŠ¡çº¿åˆ†ç»„ï¼ˆæ”¯ä»˜ã€è®¢å•ã€ç”¨æˆ·ç­‰ï¼‰
- æŒ‰ç¯å¢ƒåˆ†ç»„ï¼ˆç”Ÿäº§ã€æµ‹è¯•ã€å¼€å‘ï¼‰
- æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç»„ï¼ˆcriticalã€warningã€infoï¼‰
- è®¾ç½®å‘Šè­¦å‡çº§é“¾ï¼šå·¥ç¨‹å¸ˆâ†’ä¸»ç®¡â†’æ€»ç›‘â†’CTO
```

### 8.4 æœ€ä½³å®è·µå»ºè®®



**ğŸ”¸ å‘Šè­¦è§„åˆ™è®¾è®¡åŸåˆ™**
```
âœ… å‘Šè­¦è¦æœ‰æ„ä¹‰ï¼šåªæŠ¥å‘Šéœ€è¦äººå·¥å¤„ç†çš„é—®é¢˜
âœ… å‘Šè­¦è¦åŠæ—¶ï¼šé—®é¢˜å‘ç”Ÿæ—¶èƒ½å¿«é€Ÿå‘ç°
âœ… å‘Šè­¦è¦å‡†ç¡®ï¼šå‡å°‘è¯¯æŠ¥ï¼Œæé«˜å¯ä¿¡åº¦
âœ… å‘Šè­¦è¦åˆ†çº§ï¼šä¸åŒä¸¥é‡ç¨‹åº¦é‡‡ç”¨ä¸åŒå¤„ç†æ–¹å¼
```

**ğŸ”¸ é€šçŸ¥æ¸ é“é€‰æ‹©**
```
é‚®ä»¶ï¼šé€‚åˆè¯¦ç»†ä¿¡æ¯ï¼Œå·¥ä½œæ—¶é—´æŸ¥çœ‹
çŸ­ä¿¡ï¼šé€‚åˆç´§æ€¥å‘Šè­¦ï¼Œç«‹å³é€šçŸ¥
å³æ—¶æ¶ˆæ¯ï¼šé€‚åˆå›¢é˜Ÿåä½œï¼Œå¿«é€Ÿå“åº”
ç”µè¯ï¼šé€‚åˆæœ€é«˜çº§åˆ«å‘Šè­¦ï¼Œç¡®ä¿æ”¶åˆ°
```

**ğŸ”¸ ç»´æŠ¤ç®¡ç†å»ºè®®**
```
å®šæœŸæ£€æŸ¥ï¼š
- æ£€æŸ¥é™é»˜è§„åˆ™æ˜¯å¦è¿‡æœŸ
- æ¸…ç†æ— æ•ˆçš„è·¯ç”±è§„åˆ™  
- æ›´æ–°é€šçŸ¥æ¸ é“ä¿¡æ¯
- æµ‹è¯•å‘Šè­¦å‡çº§æµç¨‹

ç›‘æ§æŒ‡æ ‡ï¼š
- å‘Šè­¦å‘é€æˆåŠŸç‡
- å‘Šè­¦å¤„ç†å“åº”æ—¶é—´
- å‘Šè­¦è¯¯æŠ¥ç‡ç»Ÿè®¡
- é™é»˜ä½¿ç”¨é¢‘ç‡
```

### 8.5 æ•…éšœæ’æŸ¥æŒ‡å—



**ğŸ”¸ å¸¸è§é—®é¢˜**
```
å‘Šè­¦æ”¶ä¸åˆ°ï¼š
1. æ£€æŸ¥è·¯ç”±è§„åˆ™æ˜¯å¦åŒ¹é…
2. æ£€æŸ¥æ¥æ”¶è€…é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œè®¤è¯ä¿¡æ¯

å‘Šè­¦é‡å¤å‘é€ï¼š
1. æ£€æŸ¥repeat_intervalè®¾ç½®
2. æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„è·¯ç”±è§„åˆ™
3. æ£€æŸ¥Prometheusæ˜¯å¦é‡å¤å‘é€

å‘Šè­¦è¢«é™é»˜ï¼š
1. æ£€æŸ¥æ˜¯å¦æœ‰æ´»è·ƒçš„é™é»˜è§„åˆ™
2. æ£€æŸ¥æŠ‘åˆ¶è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ
3. æ£€æŸ¥å‘Šè­¦æ ‡ç­¾æ˜¯å¦åŒ¹é…é™é»˜æ¡ä»¶
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Alertmanageræ™ºèƒ½ç®¡å®¶ï¼Œå‘Šè­¦å¤„ç†ä¸æ…Œå¼ 
- è·¯ç”±åˆ†ç»„æŠ‘åˆ¶å¥½ï¼Œé™é»˜å‡çº§ç­–ç•¥å¦™  
- é…ç½®æ–‡ä»¶ç»“æ„æ¸…ï¼Œå…¨å±€è·¯ç”±æ¥æ”¶æ˜
- å®è·µæµ‹è¯•å¾ˆé‡è¦ï¼Œç›‘æ§è¿ç»´æ•ˆç‡é«˜