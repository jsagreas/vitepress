---
title: 15ã€ä¼ä¸šçº§åŒ…ç®¡ç†æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•


1. [ä¼ä¸šè½¯ä»¶ç®¡ç†ç­–ç•¥](#1-ä¼ä¸šè½¯ä»¶ç®¡ç†ç­–ç•¥)
2. [åŒ…ç®¡ç†å®‰å…¨ç­–ç•¥](#2-åŒ…ç®¡ç†å®‰å…¨ç­–ç•¥)
3. [è½¯ä»¶èµ„äº§ç®¡ç†](#3-è½¯ä»¶èµ„äº§ç®¡ç†)
4. [è®¸å¯è¯åˆè§„ç®¡ç†](#4-è®¸å¯è¯åˆè§„ç®¡ç†)
5. [æ¼æ´æ‰«æä¸ä¿®å¤æµç¨‹](#5-æ¼æ´æ‰«æä¸ä¿®å¤æµç¨‹)
6. [åŒ…ç®¡ç†å®¡è®¡ä¸æ—¥å¿—](#6-åŒ…ç®¡ç†å®¡è®¡ä¸æ—¥å¿—)
7. [æ ‡å‡†åŒ–è½¯ä»¶æ ˆ](#7-æ ‡å‡†åŒ–è½¯ä»¶æ ˆ)
8. [åŒ…ç®¡ç†è¿ç»´è§„èŒƒ](#8-åŒ…ç®¡ç†è¿ç»´è§„èŒƒ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¢ ä¼ä¸šè½¯ä»¶ç®¡ç†ç­–ç•¥



### 1.1 ä»€ä¹ˆæ˜¯ä¼ä¸šè½¯ä»¶ç®¡ç†



**ç®€å•ç†è§£**ï¼šå°±åƒç®¡ç†å…¬å¸çš„åŠå…¬ç”¨å“ä¸€æ ·ï¼Œä¼ä¸šéœ€è¦ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„è½¯ä»¶

```
ä¼ ç»Ÿä¸ªäººä½¿ç”¨ï¼š                ä¼ä¸šçº§ç®¡ç†ï¼š
éšæ„å®‰è£…è½¯ä»¶                  ç»Ÿä¸€æ ‡å‡†å’Œæµç¨‹
å„è‡ªç»´æŠ¤æ›´æ–°                  é›†ä¸­ç®¡ç†å’Œç›‘æ§
æ²¡æœ‰å®‰å…¨ç®¡æ§                  ä¸¥æ ¼çš„å®‰å…¨ç­–ç•¥
æ— æ³•è¿½æº¯é—®é¢˜                  å®Œæ•´çš„å®¡è®¡è®°å½•

ç±»æ¯”ï¼š
ä¸ªäººç”µè„‘ = è‡ªå·±çš„å·¥å…·ç®±ï¼Œæƒ³è£…ä»€ä¹ˆè£…ä»€ä¹ˆ
ä¼ä¸šæœåŠ¡å™¨ = å·¥å‚ç”Ÿäº§çº¿ï¼Œå¿…é¡»æ ‡å‡†åŒ–ç®¡ç†
```

### 1.2 ä¼ä¸šè½¯ä»¶ç®¡ç†çš„æ ¸å¿ƒç›®æ ‡



**ğŸ¯ å››å¤§æ ¸å¿ƒç›®æ ‡**ï¼š
- **æ ‡å‡†åŒ–**ï¼šæ‰€æœ‰æœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„è½¯ä»¶ç‰ˆæœ¬
- **å®‰å…¨æ€§**ï¼šç¡®ä¿è½¯ä»¶æ¥æºå¯é ï¼Œæ²¡æœ‰å®‰å…¨æ¼æ´
- **å¯æ§æ€§**ï¼šçŸ¥é“è£…äº†ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™è£…çš„ï¼Œè°è£…çš„
- **åˆè§„æ€§**ï¼šç¬¦åˆæ³•å¾‹æ³•è§„å’Œå…¬å¸æ”¿ç­–è¦æ±‚

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šä¼ä¸šç®¡ç†è½¯ä»¶å°±åƒç®¡ç†å‘˜å·¥ä¸€æ ·ï¼Œè¦æœ‰è§„ç« åˆ¶åº¦ã€è€ƒå‹¤è®°å½•ã€åŸ¹è®­æ ‡å‡†

### 1.3 ä¼ä¸šè½¯ä»¶ç®¡ç†æ¶æ„



**ğŸ— å…¸å‹çš„ä¼ä¸šè½¯ä»¶ç®¡ç†æ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¼ä¸šè½¯ä»¶ç®¡ç†å¹³å°                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­–ç•¥ç®¡ç†ä¸­å¿ƒ  â”‚ è½¯ä»¶ä»“åº“ä¸­å¿ƒ  â”‚ å®‰å…¨æ‰«æä¸­å¿ƒ  â”‚ å®¡è®¡ç›‘æ§ä¸­å¿ƒ  â”‚
â”‚             â”‚             â”‚             â”‚             â”‚
â”‚ â€¢ æ ‡å‡†åˆ¶å®š   â”‚ â€¢ æœ¬åœ°é•œåƒ   â”‚ â€¢ æ¼æ´æ‰«æ   â”‚ â€¢ æ“ä½œè®°å½•   â”‚
â”‚ â€¢ æƒé™æ§åˆ¶   â”‚ â€¢ ç‰ˆæœ¬ç®¡ç†   â”‚ â€¢ ç­¾åéªŒè¯   â”‚ â€¢ åˆè§„æ£€æŸ¥   â”‚
â”‚ â€¢ æµç¨‹å®¡æ‰¹   â”‚ â€¢ ç¼“å­˜åŠ é€Ÿ   â”‚ â€¢ æ¶æ„æ£€æµ‹   â”‚ â€¢ æŠ¥è¡¨ç”Ÿæˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”Ÿäº§æœåŠ¡å™¨ç¾¤                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   WebæœåŠ¡å™¨  â”‚  æ•°æ®åº“æœåŠ¡å™¨ â”‚  åº”ç”¨æœåŠ¡å™¨  â”‚  ç›‘æ§æœåŠ¡å™¨  â”‚
â”‚             â”‚             â”‚             â”‚             â”‚
â”‚ ç»Ÿä¸€è½¯ä»¶æ ˆ   â”‚ ç»Ÿä¸€è½¯ä»¶æ ˆ   â”‚ ç»Ÿä¸€è½¯ä»¶æ ˆ   â”‚ ç»Ÿä¸€è½¯ä»¶æ ˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 è½¯ä»¶ç®¡ç†ç­–ç•¥åˆ¶å®š



**ğŸ“‹ åˆ¶å®šä¼ä¸šè½¯ä»¶ç®¡ç†ç­–ç•¥çš„æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¸âƒ£ ç°çŠ¶è°ƒç ”**
```bash
# ç›˜ç‚¹ç°æœ‰è½¯ä»¶æƒ…å†µ

rpm -qa | sort > current_packages.txt  # CentOS/RHEL
dpkg -l | sort > current_packages.txt  # Debian/Ubuntu

# åˆ†æè½¯ä»¶ä½¿ç”¨æƒ…å†µ

yum history list all  # æŸ¥çœ‹å®‰è£…å†å²
apt log /var/log/apt/history.log  # Ubuntuå®‰è£…å†å²
```

**æ­¥éª¤2ï¸âƒ£ åˆ†ç±»ç®¡ç†**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¸å¿ƒè½¯ä»¶    â”‚    â”‚  ä¸šåŠ¡è½¯ä»¶    â”‚    â”‚  å·¥å…·è½¯ä»¶    â”‚
â”‚             â”‚    â”‚             â”‚    â”‚             â”‚
â”‚ â€¢ æ“ä½œç³»ç»Ÿ   â”‚    â”‚ â€¢ æ•°æ®åº“     â”‚    â”‚ â€¢ ç¼–è¾‘å™¨     â”‚
â”‚ â€¢ åŸºç¡€è¿è¡Œåº“  â”‚    â”‚ â€¢ WebæœåŠ¡å™¨  â”‚    â”‚ â€¢ ç›‘æ§å·¥å…·   â”‚
â”‚ â€¢ ç½‘ç»œæœåŠ¡   â”‚    â”‚ â€¢ åº”ç”¨æ¡†æ¶   â”‚    â”‚ â€¢ å¼€å‘å·¥å…·   â”‚
â”‚             â”‚    â”‚             â”‚    â”‚             â”‚
â”‚ ä¸¥æ ¼ç®¡æ§     â”‚    â”‚ æ ‡å‡†åŒ–ç®¡ç†   â”‚    â”‚ çµæ´»ç®¡ç†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”’ åŒ…ç®¡ç†å®‰å…¨ç­–ç•¥



### 2.1 è½¯ä»¶æ¥æºå®‰å…¨æ§åˆ¶



**æ ¸å¿ƒç†å¿µ**ï¼šå°±åƒé£Ÿå“å®‰å…¨ä¸€æ ·ï¼Œè½¯ä»¶ä¹Ÿè¦ç¡®ä¿æ¥æºå¯é 

**ğŸ›¡ï¸ è½¯ä»¶æ¥æºå®‰å…¨ç­‰çº§**ï¼š

```
å®‰å…¨ç­‰çº§ä»é«˜åˆ°ä½ï¼š

â­â­â­ å®˜æ–¹ä»“åº“ï¼š
â””â”€ æ“ä½œç³»ç»Ÿå®˜æ–¹æºï¼ˆå¦‚CentOS Baseã€Ubuntu Mainï¼‰
â””â”€ è½¯ä»¶å‚å•†å®˜æ–¹æºï¼ˆå¦‚Dockerå®˜æ–¹æºã€MySQLå®˜æ–¹æºï¼‰

â­â­ å¯ä¿¡ç¬¬ä¸‰æ–¹ï¼š
â””â”€ çŸ¥åæœºæ„ç»´æŠ¤çš„æºï¼ˆå¦‚EPELã€PPAï¼‰
â””â”€ ç»è¿‡éªŒè¯çš„ä¼ä¸šæº

â­ éœ€è¦éªŒè¯ï¼š
â””â”€ ç¤¾åŒºç»´æŠ¤çš„æº
â””â”€ ä¸ªäººå¼€å‘è€…æä¾›çš„æº

âŒ ç¦æ­¢ä½¿ç”¨ï¼š
â””â”€ æ¥æºä¸æ˜çš„è½¯ä»¶åŒ…
â””â”€ æœªç­¾åçš„è½¯ä»¶åŒ…
```

### 2.2 è½¯ä»¶åŒ…ç­¾åéªŒè¯



**ä»€ä¹ˆæ˜¯è½¯ä»¶åŒ…ç­¾å**ï¼š
- å°±åƒèº«ä»½è¯ä¸€æ ·ï¼Œè¯æ˜è½¯ä»¶åŒ…æ˜¯çœŸçš„ï¼Œæ²¡æœ‰è¢«ç¯¡æ”¹
- è½¯ä»¶å‘å¸ƒè€…ç”¨ç§é’¥å¯¹è½¯ä»¶åŒ…"ç­¾å"
- ç”¨æˆ·ç”¨å…¬é’¥éªŒè¯"ç­¾å"çš„çœŸå®æ€§

**ğŸ” é…ç½®ç­¾åéªŒè¯**ï¼š

**CentOS/RHEL ç­¾åéªŒè¯**ï¼š
```bash
# æŸ¥çœ‹å½“å‰GPGå¯†é’¥

rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release} %{summary}\n'

# å¯¼å…¥å®˜æ–¹GPGå¯†é’¥

rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7

# éªŒè¯è½¯ä»¶åŒ…ç­¾å

rpm --checksig package.rpm

# é…ç½®yumå¼ºåˆ¶éªŒè¯ç­¾å

vi /etc/yum.conf
# æ·»åŠ æˆ–ä¿®æ”¹ï¼š

gpgcheck=1        # å¯ç”¨GPGç­¾åæ£€æŸ¥
localpkg_gpgcheck=1  # æœ¬åœ°åŒ…ä¹Ÿè¦éªŒè¯
```

**Ubuntu/Debian ç­¾åéªŒè¯**ï¼š
```bash
# æŸ¥çœ‹å½“å‰å¯†é’¥

apt-key list

# æ·»åŠ å¯ä¿¡ä»»çš„GPGå¯†é’¥

wget -qO - https://download.docker.com/linux/ubuntu/gpg | apt-key add -

# éªŒè¯è½¯ä»¶åŒ…

debsums -c  # æ£€æŸ¥å·²å®‰è£…åŒ…çš„å®Œæ•´æ€§

# é…ç½®aptå¼ºåˆ¶éªŒè¯

vi /etc/apt/apt.conf.d/99security
# æ·»åŠ ï¼š

APT::Get::AllowUnauthenticated "false";
```

### 2.3 å†…ç½‘è½¯ä»¶ä»“åº“å»ºè®¾



**ä¸ºä»€ä¹ˆè¦å»ºå†…ç½‘ä»“åº“**ï¼š
- **å®‰å…¨éš”ç¦»**ï¼šå†…ç½‘ç¯å¢ƒä¸ç›´æ¥è®¿é—®å¤–ç½‘
- **é€Ÿåº¦æå‡**ï¼šæœ¬åœ°è®¿é—®æ¯”å¤–ç½‘å¿«å¾ˆå¤š
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šé”å®šæµ‹è¯•è¿‡çš„è½¯ä»¶ç‰ˆæœ¬
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³å®‰å…¨åˆè§„éœ€æ±‚

**ğŸ— æ­å»ºå†…ç½‘yumä»“åº“**ï¼š

```bash
# 1. å®‰è£…å¿…è¦è½¯ä»¶

yum install -y nginx createrepo yum-utils

# 2. åˆ›å»ºä»“åº“ç›®å½•

mkdir -p /var/www/html/centos/7/x86_64/
cd /var/www/html/centos/7/x86_64/

# 3. åŒæ­¥å®˜æ–¹ä»“åº“ï¼ˆé€‰æ‹©éœ€è¦çš„åŒ…ï¼‰

reposync -p /var/www/html/centos/7/x86_64/ -r base -r updates -r extras

# 4. åˆ›å»ºä»“åº“å…ƒæ•°æ®

createrepo /var/www/html/centos/7/x86_64/base/
createrepo /var/www/html/centos/7/x86_64/updates/

# 5. é…ç½®nginx

vi /etc/nginx/nginx.conf
```

**nginxé…ç½®ç¤ºä¾‹**ï¼š
```nginx
server {
    listen 80;
    server_name repo.company.com;
    root /var/www/html;
    
    location / {
        autoindex on;           # å…è®¸ç›®å½•æµè§ˆ
        autoindex_exact_size off;
        autoindex_localtime on;
    }
    
#    # è®¿é—®æ—¥å¿—è®°å½•ä¸‹è½½æƒ…å†µ
    access_log /var/log/nginx/repo_access.log combined;
}
```

---

## 3. ğŸ“¦ è½¯ä»¶èµ„äº§ç®¡ç†



### 3.1 ä»€ä¹ˆæ˜¯è½¯ä»¶èµ„äº§ç®¡ç†



**é€šä¿—ç†è§£**ï¼šå°±åƒå…¬å¸ç®¡ç†å›ºå®šèµ„äº§ï¼ˆç”µè„‘ã€æ¡Œæ¤…ï¼‰ä¸€æ ·ï¼Œéœ€è¦ç®¡ç†æ‰€æœ‰çš„è½¯ä»¶èµ„äº§

**è½¯ä»¶èµ„äº§åŒ…æ‹¬**ï¼š
- **å•†ä¸šè½¯ä»¶**ï¼šéœ€è¦è´­ä¹°è®¸å¯è¯çš„è½¯ä»¶ï¼ˆå¦‚Oracleæ•°æ®åº“ï¼‰
- **å¼€æºè½¯ä»¶**ï¼šå…è´¹ä½¿ç”¨ä½†è¦éµå®ˆå¼€æºåè®®
- **è‡ªç ”è½¯ä»¶**ï¼šå…¬å¸å†…éƒ¨å¼€å‘çš„è½¯ä»¶
- **ç¬¬ä¸‰æ–¹ç»„ä»¶**ï¼šé›†æˆåˆ°ç³»ç»Ÿä¸­çš„å¤–éƒ¨ç»„ä»¶

### 3.2 è½¯ä»¶èµ„äº§æ¸…å•ç®¡ç†



**ğŸ—‚ï¸ å»ºç«‹è½¯ä»¶èµ„äº§æ¸…å•**ï¼š

```
è½¯ä»¶èµ„äº§ç™»è®°è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è½¯ä»¶åç§°   â”‚   ç‰ˆæœ¬ä¿¡æ¯   â”‚   è®¸å¯è¯ç±»å‹ â”‚   ä½¿ç”¨èŒƒå›´   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Red Hat     â”‚ RHEL 7.9    â”‚ å•†ä¸šè®¸å¯     â”‚ ç”Ÿäº§æœåŠ¡å™¨   â”‚
â”‚ MySQL       â”‚ 5.7.34      â”‚ GPL/å•†ä¸š     â”‚ æ•°æ®åº“æœåŠ¡å™¨ â”‚
â”‚ Nginx       â”‚ 1.18.0      â”‚ BSDè®¸å¯      â”‚ WebæœåŠ¡å™¨    â”‚
â”‚ Docker      â”‚ 20.10.7     â”‚ Apache 2.0   â”‚ å®¹å™¨å¹³å°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è‡ªåŠ¨åŒ–èµ„äº§ç›˜ç‚¹è„šæœ¬**ï¼š
```bash
#!/bin/bash

# è½¯ä»¶èµ„äº§ç›˜ç‚¹è„šæœ¬


echo "=== æœåŠ¡å™¨è½¯ä»¶èµ„äº§ç›˜ç‚¹æŠ¥å‘Š ==="
echo "ç”Ÿæˆæ—¶é—´: $(date)"
echo "æœåŠ¡å™¨: $(hostname)"
echo "æ“ä½œç³»ç»Ÿ: $(cat /etc/os-release | grep PRETTY_NAME)"
echo ""

echo "=== å·²å®‰è£…è½¯ä»¶åŒ… ==="
if command -v rpm >/dev/null; then
    rpm -qa --qf '%{NAME}\t%{VERSION}\t%{RELEASE}\t%{LICENSE}\n' | sort
elif command -v dpkg >/dev/null; then
    dpkg-query -W -f='${Package}\t${Version}\t${Status}\n' | grep "install ok installed"
fi

echo ""
echo "=== è¿è¡Œä¸­çš„æœåŠ¡ ==="
systemctl list-units --type=service --state=running --no-pager

echo ""
echo "=== ç½‘ç»œç«¯å£å ç”¨ ==="
netstat -tlnp | grep LISTEN
```

### 3.3 ç‰ˆæœ¬ç®¡ç†ç­–ç•¥



**ğŸ”„ è½¯ä»¶ç‰ˆæœ¬ç®¡ç†åŸåˆ™**ï¼š

```
ç‰ˆæœ¬ç®¡ç†ç­–ç•¥ï¼š

ç”Ÿäº§ç¯å¢ƒï¼š    æµ‹è¯•ç¯å¢ƒï¼š    å¼€å‘ç¯å¢ƒï¼š
   â”‚             â”‚             â”‚
   â–¼             â–¼             â–¼
ç¨³å®šç‰ˆæœ¬      æœ€æ–°ç¨³å®šç‰ˆ      æœ€æ–°ç‰ˆæœ¬
 LTSç‰ˆæœ¬       åŠŸèƒ½ç‰ˆæœ¬       å¼€å‘ç‰ˆæœ¬
   â”‚             â”‚             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        ç‰ˆæœ¬å‡çº§è·¯å¾„è§„åˆ’
```

**ç‰ˆæœ¬é”å®šé…ç½®**ï¼š
```bash
# CentOS/RHEL - é”å®šç‰¹å®šç‰ˆæœ¬

yum install yum-plugin-versionlock
yum versionlock mysql-community-server-5.7.34

# Ubuntu - é”å®šè½¯ä»¶åŒ…ç‰ˆæœ¬

apt-mark hold mysql-server=5.7.34-0ubuntu0.18.04.1

# æŸ¥çœ‹å·²é”å®šçš„åŒ…

yum versionlock list
apt-mark showhold
```

---

## 4. âš–ï¸ è®¸å¯è¯åˆè§„ç®¡ç†



### 4.1 è½¯ä»¶è®¸å¯è¯åŸºç¡€çŸ¥è¯†



**ä»€ä¹ˆæ˜¯è½¯ä»¶è®¸å¯è¯**ï¼š
å°±åƒå¼€è½¦éœ€è¦é©¾é©¶è¯ä¸€æ ·ï¼Œä½¿ç”¨è½¯ä»¶ä¹Ÿéœ€è¦éµå®ˆè®¸å¯è¯è§„å®š

**ğŸ·ï¸ å¸¸è§è®¸å¯è¯ç±»å‹**ï¼š

```
è®¸å¯è¯åˆ†ç±»å›¾ï¼š

è½¯ä»¶è®¸å¯è¯
â”œâ”€â”€ å•†ä¸šè®¸å¯è¯ï¼ˆè¦èŠ±é’±ï¼‰
â”‚   â”œâ”€â”€ æ°¸ä¹…è®¸å¯ï¼ˆä¹°æ–­ï¼‰
â”‚   â”œâ”€â”€ è®¢é˜…è®¸å¯ï¼ˆæŒ‰å¹´ä»˜è´¹ï¼‰
â”‚   â””â”€â”€ æŒ‰ä½¿ç”¨é‡è®¡è´¹
â”‚
â””â”€â”€ å¼€æºè®¸å¯è¯ï¼ˆå…è´¹ä½¿ç”¨ï¼‰
    â”œâ”€â”€ å®½æ¾è®¸å¯è¯ï¼ˆMITã€BSDã€Apacheï¼‰
    â”‚   â””â”€â”€ å‡ ä¹å¯ä»¥éšæ„ä½¿ç”¨ï¼ŒåŒ…æ‹¬å•†ä¸šç”¨é€”
    â”‚
    â”œâ”€â”€ Copyleftè®¸å¯è¯ï¼ˆGPLã€AGPLï¼‰
    â”‚   â””â”€â”€ ä¿®æ”¹åå¿…é¡»å¼€æºï¼Œç—…æ¯’å¼ä¼ æ’­
    â”‚
    â””â”€â”€ å¼±Copyleftï¼ˆLGPLã€MPLï¼‰
        â””â”€â”€ éƒ¨åˆ†å¼€æºè¦æ±‚ï¼Œç›¸å¯¹çµæ´»
```

### 4.2 è®¸å¯è¯åˆè§„æ£€æŸ¥



**ğŸ” è®¸å¯è¯åˆè§„æ£€æŸ¥å·¥å…·**ï¼š

```bash
# å®‰è£…è®¸å¯è¯æ‰«æå·¥å…·

pip install licenseheaders
pip install license-check

# æ‰«æPythoné¡¹ç›®çš„ä¾èµ–è®¸å¯è¯

pip install pip-licenses
pip-licenses --format=table --with-license-file

# æ‰«æç³»ç»Ÿå·²å®‰è£…è½¯ä»¶çš„è®¸å¯è¯

rpm -qa --qf '%{NAME}\t%{LICENSE}\n' | sort | uniq

# ç”Ÿæˆè®¸å¯è¯æŠ¥å‘Š

#!/bin/bash

echo "è½¯ä»¶è®¸å¯è¯åˆè§„æŠ¥å‘Š" > license_report.txt
echo "ç”Ÿæˆæ—¶é—´: $(date)" >> license_report.txt
echo "========================" >> license_report.txt
rpm -qa --qf '%{NAME}\t%{VERSION}\t%{LICENSE}\n' | while read name version license; do
    case "$license" in
        *GPL*) echo "âš ï¸  éœ€è¦æ³¨æ„: $name $version ($license)" >> license_report.txt ;;
        *Commercial*) echo "ğŸ’° å•†ä¸šè®¸å¯: $name $version ($license)" >> license_report.txt ;;
        *) echo "âœ… å…¼å®¹è®¸å¯: $name $version ($license)" >> license_report.txt ;;
    esac
done
```

### 4.3 è®¸å¯è¯é£é™©ç®¡ç†



**ğŸš¨ è®¸å¯è¯é£é™©ç­‰çº§**ï¼š

| é£é™©ç­‰çº§ | **è®¸å¯è¯ç±»å‹** | **é£é™©æè¿°** | **åº”å¯¹ç­–ç•¥** |
|---------|-------------|-------------|-------------|
| ğŸ”´ **é«˜é£é™©** | `AGPLã€å¼ºåˆ¶å¼€æº` | `æ•´ä¸ªé¡¹ç›®å¿…é¡»å¼€æº` | `é¿å…ä½¿ç”¨æˆ–éš”ç¦»éƒ¨ç½²` |
| ğŸŸ¡ **ä¸­é£é™©** | `GPLã€ä¼ æŸ“æ€§å¼€æº` | `ä¿®æ”¹éƒ¨åˆ†å¿…é¡»å¼€æº` | `ä»…åŠ¨æ€é“¾æ¥ä½¿ç”¨` |
| ğŸŸ¢ **ä½é£é™©** | `MITã€BSDã€Apache` | `å‡ ä¹æ— é™åˆ¶ä½¿ç”¨` | `ä¿ç•™ç‰ˆæƒå£°æ˜å³å¯` |
| ğŸ’° **å•†ä¸šé£é™©** | `å•†ä¸šè®¸å¯è¯` | `éœ€è¦ä»˜è´¹è´­ä¹°` | `ç¡®ä¿è®¸å¯è¯æ•°é‡å……è¶³` |

> âš ï¸ **é‡è¦æé†’**ï¼šGPLç±»è®¸å¯è¯æœ‰"ç—…æ¯’æ€§"ï¼Œä¼š"ä¼ æŸ“"ç»™æ•´ä¸ªé¡¹ç›®ï¼Œä¼ä¸šä½¿ç”¨éœ€è°¨æ…

---

## 5. ğŸ›¡ï¸ æ¼æ´æ‰«æä¸ä¿®å¤æµç¨‹



### 5.1 ä¸ºä»€ä¹ˆè¦è¿›è¡Œæ¼æ´æ‰«æ



**é€šä¿—ç†è§£**ï¼šå°±åƒå®šæœŸä½“æ£€ä¸€æ ·ï¼Œéœ€è¦å®šæœŸæ£€æŸ¥è½¯ä»¶æ˜¯å¦æœ‰"ç—…æ¯’"ï¼ˆå®‰å…¨æ¼æ´ï¼‰

**æ¼æ´çš„å±å®³**ï¼š
- **æ•°æ®æ³„éœ²**ï¼šæ•æ„Ÿä¿¡æ¯è¢«çªƒå–
- **ç³»ç»Ÿè¢«æ§**ï¼šæœåŠ¡å™¨è¢«é»‘å®¢æ§åˆ¶
- **æœåŠ¡ä¸­æ–­**ï¼šä¸šåŠ¡æ— æ³•æ­£å¸¸è¿è¡Œ
- **æ³•å¾‹é£é™©**ï¼šè¿åæ•°æ®ä¿æŠ¤æ³•è§„

### 5.2 æ¼æ´æ‰«æå·¥å…·ä¸æ–¹æ³•



**ğŸ” å¸¸ç”¨æ¼æ´æ‰«æå·¥å…·**ï¼š

**ç³»ç»Ÿçº§æ¼æ´æ‰«æ**ï¼š
```bash
# CentOS/RHEL - ä½¿ç”¨yum-securityæ’ä»¶

yum install yum-plugin-security
yum --security check-update      # æ£€æŸ¥å®‰å…¨æ›´æ–°
yum --security update           # å®‰è£…å®‰å…¨æ›´æ–°

# Ubuntu - ä½¿ç”¨unattended-upgrades

apt install unattended-upgrades
unattended-upgrade --dry-run    # æ¨¡æ‹Ÿå®‰å…¨æ›´æ–°

# ä½¿ç”¨OpenSCAPè¿›è¡Œåˆè§„æ‰«æ

yum install openscap-scanner scap-security-guide
oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_pci-dss \
    --results results.xml \
    /usr/share/xml/scap/ssg/content/ssg-centos7-ds.xml
```

**åº”ç”¨çº§æ¼æ´æ‰«æ**ï¼š
```bash
# ä½¿ç”¨Nmapè¿›è¡Œç«¯å£æ‰«æ

nmap -sV -sC target_server

# ä½¿ç”¨Niktoè¿›è¡ŒWebåº”ç”¨æ‰«æ

nikto -h http://target_server

# ä½¿ç”¨å®‰å…¨æ‰«æè„šæœ¬

#!/bin/bash

echo "=== ç³»ç»Ÿå®‰å…¨æ‰«ææŠ¥å‘Š ==="
echo "æ‰«ææ—¶é—´: $(date)"

# æ£€æŸ¥é«˜å±ç«¯å£

echo "=== å¼€æ”¾ç«¯å£æ£€æŸ¥ ==="
netstat -tlnp | grep -E ':22|:80|:443|:3306|:5432'

# æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·

echo "=== ç³»ç»Ÿç”¨æˆ·æ£€æŸ¥ ==="
awk -F: '$3>=1000 && $1!="nobody" {print $1":"$3":"$7}' /etc/passwd

# æ£€æŸ¥SUIDæ–‡ä»¶

echo "=== SUIDæ–‡ä»¶æ£€æŸ¥ ==="
find / -type f -perm -4000 -ls 2>/dev/null
```

### 5.3 æ¼æ´ä¿®å¤æµç¨‹



**ğŸ”§ æ ‡å‡†åŒ–æ¼æ´ä¿®å¤æµç¨‹**ï¼š

```
æ¼æ´ä¿®å¤æµç¨‹å›¾ï¼š

å‘ç°æ¼æ´ â†’ é£é™©è¯„ä¼° â†’ åˆ¶å®šæ–¹æ¡ˆ â†’ æµ‹è¯•éªŒè¯ â†’ ç”Ÿäº§éƒ¨ç½² â†’ éªŒè¯ç»“æœ
   â”‚           â”‚           â”‚           â”‚           â”‚           â”‚
   â–¼           â–¼           â–¼           â–¼           â–¼           â–¼
æ¼æ´æ‰«æ     è¯„ä¼°å½±å“     é€‰æ‹©ç­–ç•¥     æµ‹è¯•ç¯å¢ƒ     ç”Ÿäº§ç¯å¢ƒ     å®‰å…¨éªŒè¯
è‡ªåŠ¨å‘Šè­¦     ä¸šåŠ¡é£é™©     è¡¥ä¸/ç¼“è§£     åŠŸèƒ½æµ‹è¯•     æ»šåŠ¨æ›´æ–°     æ¼æ´å¤æŸ¥
```

**æ¼æ´ä¿®å¤ç­–ç•¥é€‰æ‹©**ï¼š

| æ¼æ´ç­‰çº§ | **ä¿®å¤æ—¶é™** | **ä¿®å¤ç­–ç•¥** | **å…·ä½“è¡ŒåŠ¨** |
|---------|-------------|-------------|-------------|
| ğŸ”´ **ç´§æ€¥** | `24å°æ—¶å†…` | `ç«‹å³ä¿®å¤` | `åœæœåŠ¡æ‰“è¡¥ä¸æˆ–ä¸´æ—¶ç¼“è§£` |
| ğŸŸ¡ **é«˜å±** | `72å°æ—¶å†…` | `è®¡åˆ’ä¿®å¤` | `æµ‹è¯•åæ‰¹é‡æ›´æ–°` |
| ğŸŸ¢ **ä¸­å±** | `1å‘¨å†…` | `å¸¸è§„ä¿®å¤` | `ä¸‹æ¬¡ç»´æŠ¤çª—å£ä¿®å¤` |
| ğŸ”µ **ä½å±** | `1æœˆå†…` | `æ‹©æœŸä¿®å¤` | `ç‰ˆæœ¬å‡çº§æ—¶ä¸€å¹¶å¤„ç†` |

---

## 6. ğŸ“Š åŒ…ç®¡ç†å®¡è®¡ä¸æ—¥å¿—



### 6.1 ä¸ºä»€ä¹ˆè¦å®¡è®¡åŒ…ç®¡ç†æ“ä½œ



**å®¡è®¡çš„ä»·å€¼**ï¼š
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³SOXã€ISO27001ç­‰åˆè§„æ ‡å‡†
- **å®‰å…¨è¿½æº¯**ï¼šå‡ºé—®é¢˜æ—¶èƒ½å¿«é€Ÿå®šä½åŸå› 
- **å˜æ›´ç®¡ç†**ï¼šè®°å½•æ‰€æœ‰ç³»ç»Ÿå˜æ›´
- **æ€§èƒ½åˆ†æ**ï¼šäº†è§£ç³»ç»Ÿå˜åŒ–å¯¹æ€§èƒ½çš„å½±å“

### 6.2 åŒ…ç®¡ç†æ—¥å¿—é…ç½®



**ğŸ“ é…ç½®è¯¦ç»†çš„åŒ…ç®¡ç†æ—¥å¿—**ï¼š

**YUMæ—¥å¿—é…ç½®**ï¼š
```bash
# é…ç½®yumè¯¦ç»†æ—¥å¿—

vi /etc/yum.conf
# æ·»åŠ æˆ–ä¿®æ”¹ï¼š

logfile=/var/log/yum.log
debuglevel=2
```

**APTæ—¥å¿—é…ç½®**ï¼š
```bash
# Ubuntu/Debiançš„APTæ—¥å¿—é»˜è®¤å·²å¯ç”¨

# æ—¥å¿—ä½ç½®ï¼š

/var/log/apt/history.log    # å®‰è£…å†å²
/var/log/apt/term.log       # è¯¦ç»†è¾“å‡º
/var/log/dpkg.log          # dpkgæ“ä½œæ—¥å¿—
```

**è‡ªå®šä¹‰å®¡è®¡è„šæœ¬**ï¼š
```bash
#!/bin/bash

# åŒ…ç®¡ç†æ“ä½œå®¡è®¡è„šæœ¬


AUDIT_LOG="/var/log/package_audit.log"
USER=$(who am i | awk '{print $1}')
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

# è®°å½•å‡½æ•°

log_action() {
    echo "[$TIMESTAMP] USER:$USER ACTION:$1 DETAILS:$2" >> $AUDIT_LOG
}

# åŒ…è£…yumå‘½ä»¤

yum() {
    log_action "YUM" "$*"
    /usr/bin/yum "$@"
    RESULT=$?
    log_action "YUM_RESULT" "Exit code: $RESULT"
    return $RESULT
}

# åŒ…è£…aptå‘½ä»¤

apt() {
    log_action "APT" "$*"
    /usr/bin/apt "$@"
    RESULT=$?
    log_action "APT_RESULT" "Exit code: $RESULT"
    return $RESULT
}
```

### 6.3 å®¡è®¡æŠ¥è¡¨ç”Ÿæˆ



**ğŸ“ˆ ç”ŸæˆåŒ…ç®¡ç†å®¡è®¡æŠ¥è¡¨**ï¼š

```bash
#!/bin/bash

# åŒ…ç®¡ç†å®¡è®¡æŠ¥è¡¨ç”Ÿæˆè„šæœ¬


generate_report() {
    local start_date=${1:-$(date -d '30 days ago' +%Y-%m-%d)}
    local end_date=${2:-$(date +%Y-%m-%d)}
    local report_file="/tmp/package_audit_report_$(date +%Y%m%d).html"

    cat > $report_file << EOF
<!DOCTYPE html>
<html>
<head>
    <title>è½¯ä»¶åŒ…ç®¡ç†å®¡è®¡æŠ¥è¡¨</title>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .install { background-color: #d4edda; }
        .remove { background-color: #f8d7da; }
        .update { background-color: #d1ecf1; }
    </style>
</head>
<body>
    <h1>è½¯ä»¶åŒ…ç®¡ç†å®¡è®¡æŠ¥è¡¨</h1>
    <p>æŠ¥è¡¨æœŸé—´: $start_date è‡³ $end_date</p>
    
    <h2>æ“ä½œç»Ÿè®¡</h2>
    <table>
        <tr><th>æ“ä½œç±»å‹</th><th>æ¬¡æ•°</th></tr>
EOF

#    # ç»Ÿè®¡å„ç±»æ“ä½œ
    if [[ -f /var/log/yum.log ]]; then
        echo "        <tr><td>YUMå®‰è£…</td><td>$(grep -c 'Installed:' /var/log/yum.log)</td></tr>" >> $report_file
        echo "        <tr><td>YUMæ›´æ–°</td><td>$(grep -c 'Updated:' /var/log/yum.log)</td></tr>" >> $report_file
        echo "        <tr><td>YUMåˆ é™¤</td><td>$(grep -c 'Erased:' /var/log/yum.log)</td></tr>" >> $report_file
    fi

    cat >> $report_file << EOF
    </table>
    
    <h2>æœ€è¿‘æ“ä½œè®°å½•</h2>
    <table>
        <tr><th>æ—¶é—´</th><th>ç”¨æˆ·</th><th>æ“ä½œ</th><th>è½¯ä»¶åŒ…</th></tr>
EOF

#    # æ·»åŠ æœ€è¿‘çš„æ“ä½œè®°å½•
    if [[ -f /var/log/yum.log ]]; then
        tail -20 /var/log/yum.log | while read line; do
            echo "        <tr class='install'><td colspan='4'>$line</td></tr>" >> $report_file
        done
    fi

    cat >> $report_file << EOF
    </table>
</body>
</html>
EOF

    echo "å®¡è®¡æŠ¥è¡¨å·²ç”Ÿæˆ: $report_file"
}

# ä½¿ç”¨ç¤ºä¾‹

generate_report "2024-01-01" "2024-01-31"
```

---

## 7. ğŸ“ æ ‡å‡†åŒ–è½¯ä»¶æ ˆ



### 7.1 ä»€ä¹ˆæ˜¯æ ‡å‡†åŒ–è½¯ä»¶æ ˆ



**é€šä¿—ç†è§£**ï¼šå°±åƒéº¦å½“åŠ³çš„æ ‡å‡†åŒ–ä¸€æ ·ï¼Œæ‰€æœ‰é—¨åº—éƒ½ç”¨ç›¸åŒçš„è®¾å¤‡ã€ç›¸åŒçš„æµç¨‹

**è½¯ä»¶æ ˆæ ‡å‡†åŒ–çš„å¥½å¤„**ï¼š
- **é™ä½å¤æ‚åº¦**ï¼šå‡å°‘ä¸åŒç¯å¢ƒçš„å·®å¼‚
- **æé«˜æ•ˆç‡**ï¼šç»Ÿä¸€çš„ç»´æŠ¤å’Œç®¡ç†æ–¹å¼
- **å‡å°‘æ•…éšœ**ï¼šé¿å…å› ç¯å¢ƒä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜
- **ä¾¿äºæ‰©å®¹**ï¼šæ–°æœåŠ¡å™¨å¯ä»¥å¿«é€Ÿæ ‡å‡†åŒ–éƒ¨ç½²

### 7.2 å®šä¹‰ä¼ä¸šè½¯ä»¶æ ˆ



**ğŸ— ä¼ä¸šæ ‡å‡†è½¯ä»¶æ ˆç¤ºä¾‹**ï¼š

```
ä¼ä¸šæ ‡å‡†è½¯ä»¶æ ˆæ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨å±‚è½¯ä»¶æ ˆ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WebæœåŠ¡å™¨: Nginx 1.18.0            â”‚
â”‚ åº”ç”¨æœåŠ¡å™¨: Tomcat 9.0.44           â”‚
â”‚ æ•°æ®åº“: MySQL 8.0.25               â”‚
â”‚ ç¼“å­˜: Redis 6.2.6                 â”‚
â”‚ æ¶ˆæ¯é˜Ÿåˆ—: RabbitMQ 3.9.7           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ä¸­é—´ä»¶è½¯ä»¶æ ˆ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Javaè¿è¡Œç¯å¢ƒ: OpenJDK 11.0.12       â”‚
â”‚ Pythonç¯å¢ƒ: Python 3.8.10          â”‚
â”‚ Node.jsç¯å¢ƒ: Node.js 14.17.6       â”‚
â”‚ å®¹å™¨è¿è¡Œæ—¶: Docker 20.10.8          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ç³»ç»Ÿå±‚è½¯ä»¶æ ˆ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œç³»ç»Ÿ: CentOS 7.9               â”‚
â”‚ å†…æ ¸ç‰ˆæœ¬: 3.10.0-1160              â”‚
â”‚ ç³»ç»Ÿå·¥å…·: vim, git, curl, wget     â”‚
â”‚ ç›‘æ§ä»£ç†: Zabbix Agent 5.4.6       â”‚
â”‚ æ—¥å¿—ä»£ç†: Filebeat 7.15.0          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 è½¯ä»¶æ ˆç‰ˆæœ¬ç®¡ç†



**ğŸ“‹ è½¯ä»¶æ ˆç‰ˆæœ¬æ¸…å•æ–‡ä»¶**ï¼š

```yaml
# enterprise-software-stack.yml

# ä¼ä¸šæ ‡å‡†è½¯ä»¶æ ˆå®šä¹‰æ–‡ä»¶


meta:
  version: "2024.1"
  description: "ä¼ä¸šç”Ÿäº§ç¯å¢ƒæ ‡å‡†è½¯ä»¶æ ˆ"
  effective_date: "2024-01-01"
  review_date: "2024-06-01"

base_system:
  os: "CentOS Linux 7.9"
  kernel: "3.10.0-1160.el7.x86_64"
  architecture: "x86_64"

system_packages:
  essential:
    - name: "vim"
      version: "7.4.629"
      source: "base"
    - name: "git"
      version: "1.8.3.1"
      source: "base"
    - name: "curl"
      version: "7.29.0"
      source: "base"

runtime_environments:
  java:
    name: "java-11-openjdk"
    version: "11.0.12.0.7"
    source: "base"
  python:
    name: "python3"
    version: "3.6.8"
    source: "base"

application_services:
  web_server:
    name: "nginx"
    version: "1.18.0"
    source: "epel"
  database:
    name: "mysql80-community-release"
    version: "8.0.25"
    source: "mysql-community"
```

### 7.4 è‡ªåŠ¨åŒ–è½¯ä»¶æ ˆéƒ¨ç½²



**ğŸ¤– ä½¿ç”¨Ansibleè‡ªåŠ¨éƒ¨ç½²æ ‡å‡†è½¯ä»¶æ ˆ**ï¼š

```yaml
---
# deploy-standard-stack.yml

- name: éƒ¨ç½²ä¼ä¸šæ ‡å‡†è½¯ä»¶æ ˆ
  hosts: all
  become: yes
  
  vars:
    software_stack_version: "2024.1"
    
  tasks:
    - name: æ›´æ–°ç³»ç»Ÿåˆ°æœ€æ–°è¡¥ä¸
      yum:
        name: "*"
        state: latest
        security: yes
      
    - name: å®‰è£…EPELä»“åº“
      yum:
        name: epel-release
        state: present
        
    - name: å®‰è£…åŸºç¡€å·¥å…·è½¯ä»¶
      yum:
        name:
          - vim
          - git
          - curl
          - wget
          - htop
          - tree
        state: present
        
    - name: å®‰è£…Javaè¿è¡Œç¯å¢ƒ
      yum:
        name: java-11-openjdk
        state: present
        
    - name: é…ç½®é˜²ç«å¢™è§„åˆ™
      firewalld:
        port: "{{ item }}"
        permanent: yes
        state: enabled
        immediate: yes
      loop:
        - 22/tcp    # SSH
        - 80/tcp    # HTTP
        - 443/tcp   # HTTPS
      notify: reload firewall
      
    - name: é…ç½®ç³»ç»Ÿæ—¶åŒº
      timezone:
        name: Asia/Shanghai
        
    - name: è®°å½•éƒ¨ç½²ä¿¡æ¯
      lineinfile:
        path: /etc/motd
        line: "æ ‡å‡†è½¯ä»¶æ ˆç‰ˆæœ¬: {{ software_stack_version }} éƒ¨ç½²æ—¶é—´: {{ ansible_date_time.date }}"
        
  handlers:
    - name: reload firewall
      systemd:
        name: firewalld
        state: reloaded
```

**æ‰§è¡Œéƒ¨ç½²**ï¼š
```bash
# éƒ¨ç½²åˆ°æ‰€æœ‰æœåŠ¡å™¨

ansible-playbook -i inventory deploy-standard-stack.yml

# éƒ¨ç½²åˆ°ç‰¹å®šç»„æœåŠ¡å™¨

ansible-playbook -i inventory deploy-standard-stack.yml --limit webservers
```

---

## 8. âš™ï¸ åŒ…ç®¡ç†è¿ç»´è§„èŒƒ



### 8.1 æ—¥å¸¸è¿ç»´æµç¨‹è§„èŒƒ



**ğŸ‘¥ å»ºç«‹åŒ…ç®¡ç†è¿ç»´å›¢é˜Ÿ**ï¼š

```
åŒ…ç®¡ç†è¿ç»´ç»„ç»‡æ¶æ„ï¼š

        åŒ…ç®¡ç†å§”å‘˜ä¼š
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â”‚       â”‚
 å®‰å…¨ç»„   è¿ç»´ç»„   å¼€å‘ç»„
    â”‚       â”‚       â”‚
    â–¼       â–¼       â–¼
 å®‰å…¨å®¡æŸ¥ æ—¥å¸¸ç»´æŠ¤ éœ€æ±‚æå‡º
 æ¼æ´æ‰«æ ç‰ˆæœ¬æ›´æ–° æµ‹è¯•éªŒè¯
 åˆè§„æ£€æŸ¥ æ•…éšœå¤„ç† å˜æ›´è¯„ä¼°
```

### 8.2 å˜æ›´ç®¡ç†æµç¨‹



**ğŸ”„ è½¯ä»¶åŒ…å˜æ›´ç®¡ç†æµç¨‹**ï¼š

```
è½¯ä»¶åŒ…å˜æ›´æµç¨‹å›¾ï¼š

éœ€æ±‚æå‡º â†’ é£é™©è¯„ä¼° â†’ æ–¹æ¡ˆè®¾è®¡ â†’ æµ‹è¯•éªŒè¯ â†’ å˜æ›´å®¡æ‰¹ â†’ ç”Ÿäº§å®æ–½ â†’ éªŒè¯å›æ»š
   â”‚           â”‚           â”‚           â”‚           â”‚           â”‚           â”‚
   â–¼           â–¼           â–¼           â–¼           â–¼           â–¼           â–¼
ä¸šåŠ¡éœ€æ±‚     æŠ€æœ¯é£é™©     å®æ–½æ–¹æ¡ˆ     åŠŸèƒ½æµ‹è¯•     å˜æ›´å§”å‘˜ä¼š   æ»šåŠ¨éƒ¨ç½²     ç»“æœéªŒè¯
åˆè§„è¦æ±‚     å½±å“åˆ†æ     å›æ»šè®¡åˆ’     æ€§èƒ½æµ‹è¯•     å®‰å…¨å®¡æŸ¥     ç›‘æ§è§‚å¯Ÿ     é—®é¢˜å¤„ç†
```

**å˜æ›´ç”³è¯·æ¨¡æ¿**ï¼š
```markdown
# è½¯ä»¶åŒ…å˜æ›´ç”³è¯·è¡¨


# åŸºæœ¬ä¿¡æ¯


- **ç”³è¯·äºº**: å¼ ä¸‰
- **ç”³è¯·æ—¶é—´**: 2024-01-15
- **ç´§æ€¥ç¨‹åº¦**: æ™®é€š/é‡è¦/ç´§æ€¥
- **å½±å“ç³»ç»Ÿ**: ç”Ÿäº§WebæœåŠ¡å™¨

# å˜æ›´å†…å®¹


- **å˜æ›´ç±»å‹**: è½¯ä»¶åŒ…æ›´æ–°
- **è½¯ä»¶åç§°**: nginx
- **å½“å‰ç‰ˆæœ¬**: 1.18.0
- **ç›®æ ‡ç‰ˆæœ¬**: 1.20.2
- **å˜æ›´åŸå› **: ä¿®å¤å®‰å…¨æ¼æ´CVE-2021-23017

# é£é™©è¯„ä¼°


- **ä¸šåŠ¡é£é™©**: ä½ (å‘ä¸‹å…¼å®¹)
- **æŠ€æœ¯é£é™©**: ä¸­ (é…ç½®æ–‡ä»¶å¯èƒ½éœ€è¦è°ƒæ•´)
- **å›æ»šè®¡åˆ’**: ä¿ç•™æ—§ç‰ˆæœ¬åŒ…ï¼Œé…ç½®å¤‡ä»½

# å®æ–½è®¡åˆ’


- **æµ‹è¯•æ—¶é—´**: 2024-01-16 æµ‹è¯•ç¯å¢ƒéªŒè¯
- **å®æ–½æ—¶é—´**: 2024-01-18 21:00-23:00
- **å®æ–½æ­¥éª¤**:
  1. å¤‡ä»½ç°æœ‰é…ç½®
  2. æ›´æ–°nginxåŒ…
  3. éªŒè¯é…ç½®æ–‡ä»¶
  4. é‡å¯æœåŠ¡
  5. åŠŸèƒ½éªŒè¯

# éªŒè¯æ ‡å‡†


- [ ] æœåŠ¡æ­£å¸¸å¯åŠ¨
- [ ] Webé¡µé¢æ­£å¸¸è®¿é—®
- [ ] æ€§èƒ½æŒ‡æ ‡æ— å¼‚å¸¸
- [ ] æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯
```

### 8.3 åº”æ€¥å“åº”é¢„æ¡ˆ



**ğŸš¨ è½¯ä»¶åŒ…åº”æ€¥å“åº”é¢„æ¡ˆ**ï¼š

```bash
#!/bin/bash

# è½¯ä»¶åŒ…åº”æ€¥å“åº”è„šæœ¬


emergency_response() {
    local issue_type=$1
    local severity=$2
    
    echo "=== è½¯ä»¶åŒ…åº”æ€¥å“åº” ==="
    echo "é—®é¢˜ç±»å‹: $issue_type"
    echo "ä¸¥é‡çº§åˆ«: $severity"
    echo "å“åº”æ—¶é—´: $(date)"
    
    case $issue_type in
        "security_vulnerability")
            handle_security_incident $severity
            ;;
        "package_corruption")
            handle_package_corruption $severity
            ;;
        "dependency_conflict")
            handle_dependency_conflict $severity
            ;;
    esac
}

handle_security_incident() {
    local severity=$1
    
    echo "å¤„ç†å®‰å…¨æ¼æ´äº‹ä»¶..."
    
    if [[ $severity == "critical" ]]; then
#        # ç´§æ€¥å¤„ç†ï¼šç«‹å³éš”ç¦»å—å½±å“ç³»ç»Ÿ
        echo "CRITICAL: ç«‹å³éš”ç¦»å—å½±å“ç³»ç»Ÿ"
#        # ç¦ç”¨ç½‘ç»œè®¿é—®
        iptables -I INPUT -j DROP
        iptables -I OUTPUT -j DROP
        
#        # é€šçŸ¥å®‰å…¨å›¢é˜Ÿ
        send_alert "CRITICAL security vulnerability detected"
    fi
    
#    # æ‰«æå—å½±å“çš„è½¯ä»¶åŒ…
    yum --security check-update
    
#    # ç”Ÿæˆä¿®å¤å»ºè®®
    echo "å»ºè®®çš„ä¿®å¤æªæ–½:"
    yum --security update --assumeno
}

handle_package_corruption() {
    echo "å¤„ç†è½¯ä»¶åŒ…æŸå..."
    
#    # éªŒè¯è½¯ä»¶åŒ…å®Œæ•´æ€§
    rpm -Va > /tmp/package_verify.log
    
#    # é‡æ–°å®‰è£…æŸåçš„åŒ…
    grep "missing\|changed" /tmp/package_verify.log | while read line; do
        package=$(echo $line | awk '{print $NF}' | cut -d'/' -f1)
        echo "é‡æ–°å®‰è£…æŸåçš„åŒ…: $package"
        yum reinstall -y $package
    done
}

# ä½¿ç”¨ç¤ºä¾‹

emergency_response "security_vulnerability" "critical"
```

### 8.4 æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–



**ğŸ“Š åŒ…ç®¡ç†æ€§èƒ½ç›‘æ§**ï¼š

```bash
#!/bin/bash

# åŒ…ç®¡ç†æ€§èƒ½ç›‘æ§è„šæœ¬


monitor_package_performance() {
    local report_file="/var/log/package_performance.log"
    
    echo "=== åŒ…ç®¡ç†æ€§èƒ½ç›‘æ§æŠ¥å‘Š $(date) ===" >> $report_file
    
#    # ç›‘æ§yumä»“åº“å“åº”æ—¶é—´
    echo "=== YUMä»“åº“å“åº”æ—¶é—´ ===" >> $report_file
    time yum repolist > /dev/null 2>&1
    
#    # ç›‘æ§åŒ…ç®¡ç†æ“ä½œå»¶è¿Ÿ
    echo "=== åŒ…æŸ¥è¯¢æ€§èƒ½ ===" >> $report_file
    time yum list installed > /dev/null 2>&1
    
#    # ç›‘æ§ç£ç›˜ä½¿ç”¨æƒ…å†µ
    echo "=== è½¯ä»¶åŒ…ç¼“å­˜ç£ç›˜ä½¿ç”¨ ===" >> $report_file
    du -sh /var/cache/yum/* >> $report_file
    
#    # ç›‘æ§ç½‘ç»œå¸¦å®½ä½¿ç”¨
    echo "=== ç½‘ç»œä½¿ç”¨æƒ…å†µ ===" >> $report_file
    iftop -t -s 10 >> $report_file 2>&1 &
    
#    # æ¸…ç†å»ºè®®
    if [[ $(du -s /var/cache/yum | cut -f1) -gt 1048576 ]]; then
        echo "WARNING: YUMç¼“å­˜è¶…è¿‡1GBï¼Œå»ºè®®æ¸…ç†" >> $report_file
        echo "æ¸…ç†å‘½ä»¤: yum clean all" >> $report_file
    fi
}

# å®šæœŸæ‰§è¡Œç›‘æ§

monitor_package_performance
```

> ğŸ’¡ **æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
> - ä½¿ç”¨æœ¬åœ°é•œåƒä»“åº“å‡å°‘ç½‘ç»œå»¶è¿Ÿ
> - å®šæœŸæ¸…ç†è½¯ä»¶åŒ…ç¼“å­˜èŠ‚çœç£ç›˜ç©ºé—´
> - ä½¿ç”¨å¹¶è¡Œä¸‹è½½æé«˜å®‰è£…é€Ÿåº¦
> - é…ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´é¿å…é•¿æ—¶é—´ç­‰å¾…

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ ä¼ä¸šè½¯ä»¶ç®¡ç†ï¼šæ ‡å‡†åŒ–ã€å®‰å…¨æ€§ã€å¯æ§æ€§ã€åˆè§„æ€§å››å¤§ç›®æ ‡
ğŸ”¸ å®‰å…¨ç­–ç•¥ï¼šè½¯ä»¶æ¥æºéªŒè¯ã€ç­¾åæ£€æŸ¥ã€å†…ç½‘ä»“åº“å»ºè®¾
ğŸ”¸ èµ„äº§ç®¡ç†ï¼šè½¯ä»¶æ¸…å•ã€ç‰ˆæœ¬æ§åˆ¶ã€è®¸å¯è¯åˆè§„
ğŸ”¸ æ¼æ´ç®¡ç†ï¼šå®šæœŸæ‰«æã€é£é™©è¯„ä¼°ã€åŠæ—¶ä¿®å¤
ğŸ”¸ å®¡è®¡æ—¥å¿—ï¼šæ“ä½œè®°å½•ã€åˆè§„è¯æ˜ã€é—®é¢˜è¿½æº¯
ğŸ”¸ æ ‡å‡†åŒ–ï¼šç»Ÿä¸€è½¯ä»¶æ ˆã€è‡ªåŠ¨åŒ–éƒ¨ç½²ã€ç‰ˆæœ¬ä¸€è‡´æ€§
ğŸ”¸ è¿ç»´è§„èŒƒï¼šå˜æ›´ç®¡ç†ã€åº”æ€¥å“åº”ã€æ€§èƒ½ç›‘æ§
```

### 9.2 å…³é”®å®è·µè¦ç‚¹



**ğŸ”¹ å®‰å…¨ç¬¬ä¸€åŸåˆ™**ï¼š
```
æ‰€æœ‰è½¯ä»¶å¿…é¡»æ¥æºå¯ä¿¡ï¼š
â€¢ å®˜æ–¹ä»“åº“ > å¯ä¿¡ç¬¬ä¸‰æ–¹ > ç¤¾åŒºæº
â€¢ å¿…é¡»å¯ç”¨GPGç­¾åéªŒè¯
â€¢ ç¦æ­¢ä½¿ç”¨æ¥æºä¸æ˜çš„è½¯ä»¶åŒ…
â€¢ å»ºç«‹å†…ç½‘é•œåƒä»“åº“éš”ç¦»é£é™©
```

**ğŸ”¹ æ ‡å‡†åŒ–ç®¡ç†**ï¼š
```
ç»Ÿä¸€å°±æ˜¯ç®€åŒ–ï¼š
â€¢ å®šä¹‰æ ‡å‡†è½¯ä»¶æ ˆå¹¶ä¸¥æ ¼æ‰§è¡Œ
â€¢ ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·ç¡®ä¿ä¸€è‡´æ€§
â€¢ ç‰ˆæœ¬é”å®šé¿å…æ„å¤–å‡çº§
â€¢ å®šæœŸå®¡æŸ¥å’Œæ›´æ–°æ ‡å‡†
```

**ğŸ”¹ æŒç»­ç›‘æ§æ”¹è¿›**ï¼š
```
é¢„é˜²èƒœäºæ²»ç–—ï¼š
â€¢ å®šæœŸæ¼æ´æ‰«æå’Œå®‰å…¨æ›´æ–°
â€¢ å®Œæ•´çš„æ“ä½œå®¡è®¡å’Œæ—¥å¿—è®°å½•
â€¢ å»ºç«‹åº”æ€¥å“åº”å’Œå›æ»šæœºåˆ¶
â€¢ æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–å»ºè®®
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼



**ğŸ“Š å®æ–½ä¼˜å…ˆçº§**ï¼š

| é˜¶æ®µ | **é‡ç‚¹å·¥ä½œ** | **é¢„æœŸæ•ˆæœ** | **æ—¶é—´å‘¨æœŸ** |
|------|-------------|-------------|-------------|
| ğŸš€ **ç¬¬ä¸€é˜¶æ®µ** | `å»ºç«‹åŸºç¡€å®‰å…¨ç­–ç•¥` | `è½¯ä»¶æ¥æºå¯æ§` | `1-2ä¸ªæœˆ` |
| ğŸ“ˆ **ç¬¬äºŒé˜¶æ®µ** | `å®æ–½æ ‡å‡†åŒ–ç®¡ç†` | `ç¯å¢ƒä¸€è‡´æ€§` | `2-3ä¸ªæœˆ` |
| ğŸ” **ç¬¬ä¸‰é˜¶æ®µ** | `å®Œå–„ç›‘æ§å®¡è®¡` | `åˆè§„å’Œè¿½æº¯` | `1-2ä¸ªæœˆ` |
| ğŸ¯ **ç¬¬å››é˜¶æ®µ** | `ä¼˜åŒ–è‡ªåŠ¨åŒ–æµç¨‹` | `æ•ˆç‡æå‡` | `æŒç»­æ”¹è¿›` |

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ



**ğŸ”§ å…¸å‹é—®é¢˜å¤„ç†**ï¼š

```
é—®é¢˜1ï¼šè½¯ä»¶åŒ…ä¾èµ–å†²çª
è§£å†³ï¼š
â€¢ ä½¿ç”¨yum-utilsçš„package-cleanupå·¥å…·
â€¢ å»ºç«‹æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
â€¢ åˆ¶å®šå›æ»šè®¡åˆ’å’Œæ­¥éª¤

é—®é¢˜2ï¼šè®¸å¯è¯åˆè§„é£é™©
è§£å†³ï¼š
â€¢ ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ‰«æè®¸å¯è¯
â€¢ å»ºç«‹è®¸å¯è¯æ•°æ®åº“å’Œå®¡æŸ¥æµç¨‹
â€¢ å®šæœŸè¿›è¡Œåˆè§„æ£€æŸ¥

é—®é¢˜3ï¼šå®‰å…¨æ¼æ´å“åº”å»¶è¿Ÿ
è§£å†³ï¼š
â€¢ å»ºç«‹è‡ªåŠ¨åŒ–æ¼æ´æ‰«ææµç¨‹
â€¢ åˆ¶å®šåˆ†çº§å“åº”æœºåˆ¶
â€¢ é¢„å…ˆå‡†å¤‡åº”æ€¥ä¿®å¤æ–¹æ¡ˆ
```

### 9.5 æœ€ä½³å®è·µå»ºè®®



> ğŸ“Œ **æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
> - å®‰å…¨æ˜¯åŒ…ç®¡ç†çš„ç”Ÿå‘½çº¿ï¼Œæ¥æºå¯ä¿¡æ˜¯ç¬¬ä¸€è¦æ±‚
> - æ ‡å‡†åŒ–èƒ½å¤§å¹…é™ä½ç®¡ç†å¤æ‚åº¦å’Œæ•…éšœç‡
> - è‡ªåŠ¨åŒ–å·¥å…·æ˜¯è§„æ¨¡åŒ–ç®¡ç†çš„å¿…è¦æ‰‹æ®µ
> - å®¡è®¡æ—¥å¿—æ˜¯åˆè§„å’Œæ•…éšœæ’æŸ¥çš„é‡è¦ä¾æ®
> - æŒç»­ç›‘æ§å’Œæ”¹è¿›æ˜¯ä¼ä¸šçº§ç®¡ç†çš„åŸºæœ¬è¦æ±‚

**ğŸ¯ æˆåŠŸå®æ–½çš„å…³é”®**ï¼š
1. **é¢†å¯¼æ”¯æŒ**ï¼šè·å¾—ç®¡ç†å±‚å¯¹æ ‡å‡†åŒ–çš„æ”¯æŒ
2. **å›¢é˜Ÿåä½œ**ï¼šå»ºç«‹è·¨éƒ¨é—¨åä½œæœºåˆ¶
3. **å·¥å…·å»ºè®¾**ï¼šæŠ•èµ„è‡ªåŠ¨åŒ–å·¥å…·å’Œå¹³å°
4. **æµç¨‹è§„èŒƒ**ï¼šå»ºç«‹å’Œæ‰§è¡Œæ ‡å‡†åŒ–æµç¨‹
5. **æŒç»­æ”¹è¿›**ï¼šå®šæœŸè¯„ä¼°å’Œä¼˜åŒ–ç®¡ç†ç­–ç•¥

**æ ¸å¿ƒå£è¯€**ï¼š
- ä¼ä¸šåŒ…ç®¡ç†ï¼Œå®‰å…¨æ ‡å‡†å…ˆ
- æ¥æºè¦å¯ä¿¡ï¼Œç­¾åå¿…é¡»éªŒ  
- ç‰ˆæœ¬è¦ç»Ÿä¸€ï¼Œå˜æ›´èµ°æµç¨‹
- æ—¥å¿—è¦å®Œæ•´ï¼Œç›‘æ§ä¸èƒ½åœ