---
title: 14ã€æ„å»ºè„šæœ¬ç¼–å†™
---
## ğŸ“š ç›®å½•


1. [æ„å»ºè„šæœ¬åŸºç¡€æ¦‚å¿µ](#1-æ„å»ºè„šæœ¬åŸºç¡€æ¦‚å¿µ)
2. [è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬è®¾è®¡](#2-è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬è®¾è®¡)
3. [ç¯å¢ƒæ£€æŸ¥ä¸å‡†å¤‡](#3-ç¯å¢ƒæ£€æŸ¥ä¸å‡†å¤‡)
4. [é”™è¯¯å¤„ç†ä¸å›æ»šæœºåˆ¶](#4-é”™è¯¯å¤„ç†ä¸å›æ»šæœºåˆ¶)
5. [å¹¶è¡Œç¼–è¯‘é…ç½®](#5-å¹¶è¡Œç¼–è¯‘é…ç½®)
6. [æ„å»ºç»“æœéªŒè¯](#6-æ„å»ºç»“æœéªŒè¯)
7. [æ„å»ºç¼“å­˜ç®¡ç†](#7-æ„å»ºç¼“å­˜ç®¡ç†)
8. [å¢é‡ç¼–è¯‘æ”¯æŒ](#8-å¢é‡ç¼–è¯‘æ”¯æŒ)
9. [æ„å»ºæŠ¥å‘Šç”Ÿæˆ](#9-æ„å»ºæŠ¥å‘Šç”Ÿæˆ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ è·¯å¾„å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦æŒæ¡Shellè„šæœ¬åŸºç¡€ã€gccç¼–è¯‘å™¨ã€makeå·¥å…· â†’ **å½“å‰å†…å®¹**ï¼šæ„å»ºè„šæœ¬ç¼–å†™ â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ CI/CDè‡ªåŠ¨åŒ–éƒ¨ç½²

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡60åˆ†é’Ÿ | å®è·µç»ƒä¹ 30åˆ†é’Ÿ

---

## 1. ğŸ—ï¸ æ„å»ºè„šæœ¬åŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯æ„å»ºè„šæœ¬



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
æ„å»ºè„šæœ¬ï¼šè‡ªåŠ¨åŒ–ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…è½¯ä»¶çš„Shellè„šæœ¬
ç›®çš„ï¼šè®©å¤æ‚çš„ç¼–è¯‘è¿‡ç¨‹å˜æˆä¸€é”®æ‰§è¡Œ
æœ¬è´¨ï¼šæŠŠæ‰‹åŠ¨æ“ä½œå˜æˆè‡ªåŠ¨åŒ–æµç¨‹
```

**ğŸ’¡ é€šä¿—ç†è§£**
æƒ³è±¡ä½ è¦åšä¸€é“å¤æ‚çš„èœï¼š
- **æ‰‹å·¥æ–¹å¼**ï¼šæ¯æ¬¡éƒ½è¦è®°ä½åå‡ ä¸ªæ­¥éª¤ï¼Œå®¹æ˜“å‡ºé”™
- **æ„å»ºè„šæœ¬**ï¼šå†™å¥½é£Ÿè°±ï¼ŒæŒ‰ä¸‹æŒ‰é’®å°±è‡ªåŠ¨å®Œæˆ

### 1.2 æ„å»ºè„šæœ¬çš„ä½œç”¨



**ğŸ¯ ä¸»è¦ç”¨é€”**
```
ğŸ”¸ ç¼–è¯‘ç®¡ç†ï¼šè‡ªåŠ¨å¤„ç†æºç ç¼–è¯‘
ğŸ”¸ ä¾èµ–å¤„ç†ï¼šæ£€æŸ¥å’Œå®‰è£…å¿…è¦ç»„ä»¶  
ğŸ”¸ ç¯å¢ƒé…ç½®ï¼šè®¾ç½®ç¼–è¯‘ç¯å¢ƒå˜é‡
ğŸ”¸ è´¨é‡æ£€æŸ¥ï¼šè¿è¡Œæµ‹è¯•å’Œä»£ç æ£€æŸ¥
ğŸ”¸ æ‰“åŒ…å‘å¸ƒï¼šç”Ÿæˆå¯åˆ†å‘çš„è½¯ä»¶åŒ…
```

### 1.3 æ„å»ºè„šæœ¬ç±»å‹å¯¹æ¯”



| **è„šæœ¬ç±»å‹** | **é€‚ç”¨åœºæ™¯** | **å¤æ‚åº¦** | **ç»´æŠ¤æ€§** |
|-------------|-------------|-----------|-----------|
| **ç®€å•Shellè„šæœ¬** | å°é¡¹ç›®å¿«é€Ÿæ„å»º | â­ | â­â­â­ |
| **Makefileé©±åŠ¨** | ä¸­å‹C/C++é¡¹ç›® | â­â­â­ | â­â­â­â­ |
| **é…ç½®åŒ–è„šæœ¬** | å¤§å‹å¤šæ¨¡å—é¡¹ç›® | â­â­â­â­ | â­â­â­â­â­ |

---

## 2. ğŸš€ è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬è®¾è®¡



### 2.1 æ„å»ºè„šæœ¬åŸºæœ¬æ¶æ„



**ğŸ“‹ æ ‡å‡†ç»“æ„**
```bash
#!/bin/bash

# é¡¹ç›®æ„å»ºè„šæœ¬æ¨¡æ¿


# ================================

# 1. åŸºç¡€é…ç½®

# ================================

set -euo pipefail  # ä¸¥æ ¼æ¨¡å¼ï¼šé‡åˆ°é”™è¯¯å°±åœæ­¢

PROJECT_NAME="my_project"
BUILD_DIR="build"
SOURCE_DIR="src"

# ================================  

# 2. åŠŸèƒ½å‡½æ•°å®šä¹‰

# ================================

show_help() { echo "ä½¿ç”¨è¯´æ˜..."; }
check_environment() { echo "æ£€æŸ¥ç¯å¢ƒ..."; }
build_project() { echo "æ„å»ºé¡¹ç›®..."; }
run_tests() { echo "è¿è¡Œæµ‹è¯•..."; }

# ================================

# 3. ä¸»æµç¨‹æ§åˆ¶

# ================================

main() {
    check_environment
    build_project  
    run_tests
}

# æ‰§è¡Œä¸»å‡½æ•°

main "$@"
```

### 2.2 å‘½ä»¤è¡Œå‚æ•°å¤„ç†



**ğŸ”§ å‚æ•°è§£æç¤ºä¾‹**
```bash
# æ”¯æŒå¤šç§æ„å»ºé€‰é¡¹

while [[ $# -gt 0 ]]; do
    case $1 in
        -h|--help)
            show_help
            exit 0
            ;;
        -c|--clean)
            CLEAN_BUILD=true
            shift
            ;;
        -j|--jobs)
            JOBS="$2"
            shift 2
            ;;
        --debug)
            DEBUG_MODE=true
            shift
            ;;
        *)
            echo "âŒ æœªçŸ¥å‚æ•°: $1"
            show_help
            exit 1
            ;;
    esac
done
```

**ğŸ’¡ ç”¨æ³•ç¤ºä¾‹**
```bash
# åŸºæœ¬æ„å»º

./build.sh

# æ¸…ç†åé‡æ–°æ„å»º

./build.sh --clean

# ä½¿ç”¨8ä¸ªçº¿ç¨‹å¹¶è¡Œç¼–è¯‘

./build.sh -j 8

# è°ƒè¯•æ¨¡å¼æ„å»º

./build.sh --debug
```

### 2.3 æ„å»ºé…ç½®ç®¡ç†



**ğŸ“ é…ç½®æ–‡ä»¶åˆ†ç¦»**
```bash
# build.conf - æ„å»ºé…ç½®æ–‡ä»¶

PROJECT_NAME="web_server"
SOURCE_DIRS="src lib"
BUILD_TYPE="Release"
INSTALL_PREFIX="/opt/myapp"
PARALLEL_JOBS=4

# æ„å»ºè„šæœ¬ä¸­åŠ è½½é…ç½®

load_config() {
    if [[ -f "build.conf" ]]; then
        source build.conf
        echo "âœ… å·²åŠ è½½æ„å»ºé…ç½®"
    else
        echo "âš ï¸ ä½¿ç”¨é»˜è®¤é…ç½®"
    fi
}
```

---

## 3. ğŸ” ç¯å¢ƒæ£€æŸ¥ä¸å‡†å¤‡



### 3.1 ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥



**ğŸ” åŸºç¡€ç¯å¢ƒéªŒè¯**
```bash
check_system() {
    echo "ğŸ” æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ..."
    
#    # æ£€æŸ¥æ“ä½œç³»ç»Ÿ
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        echo "âœ… Linuxç³»ç»Ÿ"
        DISTRO=$(lsb_release -si 2>/dev/null || echo "Unknown")
        echo "   å‘è¡Œç‰ˆ: $DISTRO"
    else
        echo "âŒ ä¸æ”¯æŒçš„ç³»ç»Ÿ: $OSTYPE"
        exit 1
    fi
    
#    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    AVAILABLE_SPACE=$(df . | tail -1 | awk '{print $4}')
    REQUIRED_SPACE=1048576  # 1GB in KB
    
    if [[ $AVAILABLE_SPACE -lt $REQUIRED_SPACE ]]; then
        echo "âŒ ç£ç›˜ç©ºé—´ä¸è¶³ (éœ€è¦1GB)"
        exit 1
    else
        echo "âœ… ç£ç›˜ç©ºé—´å……è¶³"
    fi
}
```

### 3.2 ç¼–è¯‘å·¥å…·æ£€æŸ¥



**ğŸ› ï¸ å¿…éœ€å·¥å…·éªŒè¯**
```bash
check_build_tools() {
    echo "ğŸ› ï¸ æ£€æŸ¥æ„å»ºå·¥å…·..."
    
    local tools=("gcc" "make" "pkg-config" "git")
    local missing_tools=()
    
    for tool in "${tools[@]}"; do
        if command -v "$tool" >/dev/null 2>&1; then
            local version=$(${tool} --version 2>/dev/null | head -1)
            echo "âœ… $tool: $version"
        else
            missing_tools+=("$tool")
        fi
    done
    
    if [[ ${#missing_tools[@]} -gt 0 ]]; then
        echo "âŒ ç¼ºå°‘å·¥å…·: ${missing_tools[*]}"
        echo "ğŸ“ å®‰è£…å‘½ä»¤: sudo apt-get install ${missing_tools[*]}"
        exit 1
    fi
}
```

### 3.3 ä¾èµ–åº“æ£€æŸ¥



**ğŸ“¦ ä¾èµ–æ£€æŸ¥å®ç°**
```bash
check_dependencies() {
    echo "ğŸ“¦ æ£€æŸ¥ä¾èµ–åº“..."
    
#    # ä½¿ç”¨pkg-configæ£€æŸ¥åº“
    local deps=("libssl" "libcurl" "sqlite3")
    
    for dep in "${deps[@]}"; do
        if pkg-config --exists "$dep"; then
            local version=$(pkg-config --modversion "$dep")
            echo "âœ… $dep: $version"
        else
            echo "âŒ ç¼ºå°‘ä¾èµ–: $dep"
#            # æä¾›å®‰è£…å»ºè®®
            suggest_install "$dep"
            exit 1
        fi
    done
}

suggest_install() {
    local lib="$1"
    case "$lib" in
        libssl)
            echo "ğŸ“ å®‰è£…: sudo apt-get install libssl-dev"
            ;;
        libcurl)
            echo "ğŸ“ å®‰è£…: sudo apt-get install libcurl4-openssl-dev"
            ;;
        sqlite3)
            echo "ğŸ“ å®‰è£…: sudo apt-get install libsqlite3-dev"
            ;;
    esac
}
```

---

## 4. ğŸ›¡ï¸ é”™è¯¯å¤„ç†ä¸å›æ»šæœºåˆ¶



### 4.1 é”™è¯¯å¤„ç†ç­–ç•¥



**âš ï¸ é”™è¯¯æ•è·æœºåˆ¶**
```bash
# å¯ç”¨ä¸¥æ ¼é”™è¯¯å¤„ç†

set -euo pipefail

# é”™è¯¯ä¿¡æ¯è®°å½•

error_log="build_errors.log"

# é”™è¯¯å¤„ç†å‡½æ•°

handle_error() {
    local exit_code=$?
    local line_no=$1
    
    echo "âŒ æ„å»ºå¤±è´¥ï¼" | tee -a "$error_log"
    echo "   é”™è¯¯ä½ç½®: ç¬¬${line_no}è¡Œ" | tee -a "$error_log"
    echo "   é”™è¯¯ä»£ç : $exit_code" | tee -a "$error_log"
    echo "   æ—¶é—´: $(date)" | tee -a "$error_log"
    
#    # æ‰§è¡Œæ¸…ç†
    cleanup_on_error
    exit $exit_code
}

# è®¾ç½®é”™è¯¯é™·é˜±

trap 'handle_error $LINENO' ERR
```

### 4.2 æ„å»ºçŠ¶æ€è®°å½•



**ğŸ“ çŠ¶æ€è¿½è¸ªå®ç°**
```bash
# æ„å»ºæ­¥éª¤è¿½è¸ª

build_steps=("ç¯å¢ƒæ£€æŸ¥" "æºç ç¼–è¯‘" "æµ‹è¯•è¿è¡Œ" "å®‰è£…éƒ¨ç½²")
current_step=0

# æ­¥éª¤æ‰§è¡Œå‡½æ•°

execute_step() {
    local step_name="$1"
    local step_function="$2"
    
    echo "ğŸ”„ æ‰§è¡Œæ­¥éª¤: $step_name"
    echo "$step_name:å¼€å§‹:$(date)" >> build.log
    
    if $step_function; then
        echo "âœ… $step_name å®Œæˆ"
        echo "$step_name:æˆåŠŸ:$(date)" >> build.log
    else
        echo "âŒ $step_name å¤±è´¥"
        echo "$step_name:å¤±è´¥:$(date)" >> build.log
        return 1
    fi
    
    ((current_step++))
}
```

### 4.3 å›æ»šæœºåˆ¶å®ç°



**ğŸ”„ è‡ªåŠ¨å›æ»šåŠŸèƒ½**
```bash
# å¤‡ä»½é‡è¦æ–‡ä»¶

backup_files() {
    local backup_dir="backup_$(date +%Y%m%d_%H%M%S)"
    mkdir -p "$backup_dir"
    
#    # å¤‡ä»½é…ç½®æ–‡ä»¶
    if [[ -f "config/app.conf" ]]; then
        cp -r config "$backup_dir/"
        echo "âœ… å·²å¤‡ä»½é…ç½®æ–‡ä»¶åˆ° $backup_dir"
    fi
    
#    # è®°å½•å¤‡ä»½ä½ç½®
    echo "$backup_dir" > .last_backup
}

# æ¸…ç†å‡½æ•°

cleanup_on_error() {
    echo "ğŸ§¹ æ‰§è¡Œé”™è¯¯æ¸…ç†..."
    
#    # åˆ é™¤ä¸å®Œæ•´çš„æ„å»ºæ–‡ä»¶
    if [[ -d "$BUILD_DIR" ]]; then
        rm -rf "$BUILD_DIR"
        echo "âœ… å·²æ¸…ç†æ„å»ºç›®å½•"
    fi
    
#    # æ¢å¤å¤‡ä»½ï¼ˆå¦‚æœéœ€è¦ï¼‰
    if [[ -f ".last_backup" ]]; then
        local backup_dir=$(cat .last_backup)
        echo "ğŸ“ å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¢å¤å¤‡ä»½:"
        echo "   cp -r $backup_dir/config ."
    fi
}
```

---

## 5. âš¡ å¹¶è¡Œç¼–è¯‘é…ç½®



### 5.1 CPUæ ¸å¿ƒæ£€æµ‹



**ğŸ”¢ è‡ªåŠ¨æ£€æµ‹æ ¸å¿ƒæ•°**
```bash
detect_cpu_cores() {
    local cores
    
#    # Linuxç³»ç»Ÿæ£€æµ‹
    if [[ -f /proc/cpuinfo ]]; then
        cores=$(nproc 2>/dev/null || grep -c ^processor /proc/cpuinfo)
    else
        cores=1
    fi
    
#    # ä¸ºç³»ç»Ÿä¿ç•™ä¸€ä¸ªæ ¸å¿ƒ
    local build_cores=$((cores - 1))
    build_cores=${build_cores:-1}  # è‡³å°‘ä½¿ç”¨1ä¸ªæ ¸å¿ƒ
    
    echo "ğŸ’» æ£€æµ‹åˆ° $cores ä¸ªCPUæ ¸å¿ƒ"
    echo "ğŸš€ å°†ä½¿ç”¨ $build_cores ä¸ªæ ¸å¿ƒè¿›è¡Œç¼–è¯‘"
    
    export PARALLEL_JOBS="$build_cores"
}
```

### 5.2 å¹¶è¡Œç¼–è¯‘é…ç½®



**âš¡ Makeå¹¶è¡Œç¼–è¯‘**
```bash
build_with_make() {
    echo "ğŸ”¨ å¼€å§‹Makeç¼–è¯‘..."
    
#    # æ£€æµ‹æœ€ä¼˜å¹¶è¡Œæ•°
    detect_cpu_cores
    
#    # æ‰§è¡Œå¹¶è¡Œç¼–è¯‘
    if make -j"$PARALLEL_JOBS" 2>&1 | tee make.log; then
        echo "âœ… Makeç¼–è¯‘æˆåŠŸ"
    else
        echo "âŒ Makeç¼–è¯‘å¤±è´¥ï¼Œå°è¯•å•çº¿ç¨‹ç¼–è¯‘..."
        make clean
        make -j1 2>&1 | tee make_single.log
    fi
}
```

### 5.3 CMakeå¹¶è¡Œæ„å»º



**ğŸ—ï¸ CMakeé…ç½®ç¤ºä¾‹**
```bash
build_with_cmake() {
    echo "ğŸ—ï¸ ä½¿ç”¨CMakeæ„å»º..."
    
#    # åˆ›å»ºæ„å»ºç›®å½•
    mkdir -p "$BUILD_DIR"
    cd "$BUILD_DIR"
    
#    # é…ç½®é¡¹ç›®
    cmake .. \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_PREFIX="$INSTALL_PREFIX"
    
#    # å¹¶è¡Œæ„å»º
    cmake --build . --parallel "$PARALLEL_JOBS"
    
    echo "âœ… CMakeæ„å»ºå®Œæˆ"
    cd ..
}
```

---

## 6. âœ… æ„å»ºç»“æœéªŒè¯



### 6.1 ç¼–è¯‘äº§ç‰©æ£€æŸ¥



**ğŸ” è¾“å‡ºæ–‡ä»¶éªŒè¯**
```bash
verify_build_output() {
    echo "ğŸ” éªŒè¯æ„å»ºç»“æœ..."
    
    local expected_files=("bin/myapp" "lib/libmylib.so" "config/default.conf")
    local missing_files=()
    
    for file in "${expected_files[@]}"; do
        if [[ -f "$file" ]]; then
            local size=$(ls -lh "$file" | awk '{print $5}')
            echo "âœ… $file ($size)"
        else
            missing_files+=("$file")
        fi
    done
    
    if [[ ${#missing_files[@]} -gt 0 ]]; then
        echo "âŒ ç¼ºå°‘æ–‡ä»¶: ${missing_files[*]}"
        return 1
    fi
    
    echo "âœ… æ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½å·²ç”Ÿæˆ"
}
```

### 6.2 åŸºæœ¬åŠŸèƒ½æµ‹è¯•



**ğŸ§ª å¿«é€ŸåŠŸèƒ½éªŒè¯**
```bash
run_basic_tests() {
    echo "ğŸ§ª è¿è¡ŒåŸºæœ¬åŠŸèƒ½æµ‹è¯•..."
    
#    # æ£€æŸ¥ç¨‹åºèƒ½å¦å¯åŠ¨
    if ./bin/myapp --version >/dev/null 2>&1; then
        local version=$(./bin/myapp --version)
        echo "âœ… ç¨‹åºå¯åŠ¨æ­£å¸¸: $version"
    else
        echo "âŒ ç¨‹åºæ— æ³•å¯åŠ¨"
        return 1
    fi
    
#    # è¿è¡Œå†…ç½®æµ‹è¯•
    if [[ -f "tests/run_tests.sh" ]]; then
        echo "ğŸ”„ è¿è¡Œæµ‹è¯•å¥—ä»¶..."
        if bash tests/run_tests.sh; then
            echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡"
        else
            echo "âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
        fi
    fi
}
```

### 6.3 æ€§èƒ½åŸºå‡†æµ‹è¯•



**ğŸ“Š æ€§èƒ½éªŒè¯ç¤ºä¾‹**
```bash
run_performance_test() {
    echo "ğŸ“Š è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•..."
    
    if [[ ! -f "benchmark/bench.sh" ]]; then
        echo "âš ï¸ æœªæ‰¾åˆ°åŸºå‡†æµ‹è¯•è„šæœ¬ï¼Œè·³è¿‡"
        return 0
    fi
    
    echo "ğŸ”„ æ‰§è¡Œæ€§èƒ½æµ‹è¯•..."
    local start_time=$(date +%s)
    
    if bash benchmark/bench.sh > perf_results.txt 2>&1; then
        local end_time=$(date +%s)
        local duration=$((end_time - start_time))
        
        echo "âœ… æ€§èƒ½æµ‹è¯•å®Œæˆ (è€—æ—¶: ${duration}ç§’)"
        echo "ğŸ“‹ ç»“æœä¿å­˜åœ¨: perf_results.txt"
    else
        echo "âš ï¸ æ€§èƒ½æµ‹è¯•å¼‚å¸¸"
    fi
}
```

---

## 7. ğŸ’¾ æ„å»ºç¼“å­˜ç®¡ç†



### 7.1 ç¼“å­˜ç›®å½•ç®¡ç†



**ğŸ“ ç¼“å­˜ç­–ç•¥å®ç°**
```bash
setup_build_cache() {
    local cache_dir=".build_cache"
    
    echo "ğŸ’¾ è®¾ç½®æ„å»ºç¼“å­˜..."
    
#    # åˆ›å»ºç¼“å­˜ç›®å½•ç»“æ„
    mkdir -p "$cache_dir"/{objects,dependencies,tools}
    
#    # è®¾ç½®ç¼“å­˜ç¯å¢ƒå˜é‡
    export CCACHE_DIR="$cache_dir/objects"
    export PKG_CONFIG_PATH="$cache_dir/dependencies:$PKG_CONFIG_PATH"
    
#    # æ£€æŸ¥ccacheæ˜¯å¦å¯ç”¨
    if command -v ccache >/dev/null 2>&1; then
        export CC="ccache gcc"
        export CXX="ccache g++"
        echo "âœ… å¯ç”¨ccacheç¼–è¯‘ç¼“å­˜"
        
#        # æ˜¾ç¤ºç¼“å­˜ç»Ÿè®¡
        ccache -s | grep -E "(cache hit|cache miss|cache size)"
    else
        echo "ğŸ’¡ å»ºè®®å®‰è£…ccacheæå‡ç¼–è¯‘é€Ÿåº¦: sudo apt-get install ccache"
    fi
}
```

### 7.2 ç¼“å­˜æ¸…ç†æœºåˆ¶



**ğŸ§¹ æ™ºèƒ½ç¼“å­˜æ¸…ç†**
```bash
manage_cache() {
    local cache_dir=".build_cache"
    local max_cache_size="1G"  # æœ€å¤§ç¼“å­˜å¤§å°
    
    case "$1" in
        clean)
            echo "ğŸ§¹ æ¸…ç†æ„å»ºç¼“å­˜..."
            if [[ -d "$cache_dir" ]]; then
                rm -rf "$cache_dir"
                echo "âœ… ç¼“å­˜å·²æ¸…ç†"
            fi
            ;;
        check)
            if [[ -d "$cache_dir" ]]; then
                local cache_size=$(du -sh "$cache_dir" | cut -f1)
                echo "ğŸ’¾ å½“å‰ç¼“å­˜å¤§å°: $cache_size"
                
#                # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
                local size_bytes=$(du -sb "$cache_dir" | cut -f1)
                local max_bytes=1073741824  # 1GB
                
                if [[ $size_bytes -gt $max_bytes ]]; then
                    echo "âš ï¸ ç¼“å­˜è¶…è¿‡é™åˆ¶ï¼Œå»ºè®®æ¸…ç†"
                fi
            else
                echo "ğŸ’¾ æ— ç¼“å­˜ç›®å½•"
            fi
            ;;
    esac
}
```

---

## 8. ğŸ”„ å¢é‡ç¼–è¯‘æ”¯æŒ



### 8.1 æ–‡ä»¶å˜æ›´æ£€æµ‹



**ğŸ” æ™ºèƒ½å˜æ›´æ£€æµ‹**
```bash
check_source_changes() {
    local timestamp_file=".last_build"
    local source_dirs=("src" "include" "lib")
    
    echo "ğŸ” æ£€æŸ¥æºç å˜æ›´..."
    
    if [[ ! -f "$timestamp_file" ]]; then
        echo "ğŸ“ é¦–æ¬¡æ„å»ºï¼Œå°†è¿›è¡Œå®Œæ•´ç¼–è¯‘"
        return 0  # éœ€è¦å®Œæ•´æ„å»º
    fi
    
    local last_build=$(cat "$timestamp_file")
    local changed_files=()
    
#    # æ£€æŸ¥æºç æ–‡ä»¶å˜æ›´
    for dir in "${source_dirs[@]}"; do
        if [[ -d "$dir" ]]; then
            while IFS= read -r -d '' file; do
                if [[ "$file" -nt "$timestamp_file" ]]; then
                    changed_files+=("$file")
                fi
            done < <(find "$dir" -name "*.c" -o -name "*.cpp" -o -name "*.h" -print0)
        fi
    done
    
    if [[ ${#changed_files[@]} -gt 0 ]]; then
        echo "ğŸ“ æ£€æµ‹åˆ° ${#changed_files[@]} ä¸ªæ–‡ä»¶å˜æ›´"
        echo "ğŸ”„ å°†æ‰§è¡Œå¢é‡ç¼–è¯‘"
        return 0
    else
        echo "âœ… æºç æ— å˜æ›´ï¼Œè·³è¿‡ç¼–è¯‘"
        return 1
    fi
}
```

### 8.2 å¢é‡æ„å»ºå®ç°



**âš¡ é«˜æ•ˆå¢é‡ç¼–è¯‘**
```bash
incremental_build() {
    if check_source_changes; then
        echo "ğŸ”„ æ‰§è¡Œå¢é‡ç¼–è¯‘..."
        
#        # è®°å½•ç¼–è¯‘å¼€å§‹æ—¶é—´
        local build_start=$(date +%s)
        
#        # åªç¼–è¯‘å˜æ›´çš„æ–‡ä»¶
        if make -j"$PARALLEL_JOBS" 2>&1 | tee -a build.log; then
            local build_end=$(date +%s)
            local build_time=$((build_end - build_start))
            
            echo "âœ… å¢é‡ç¼–è¯‘å®Œæˆ (è€—æ—¶: ${build_time}ç§’)"
            
#            # æ›´æ–°æ—¶é—´æˆ³
            date +%s > .last_build
        else
            echo "âŒ å¢é‡ç¼–è¯‘å¤±è´¥ï¼Œå°è¯•æ¸…ç†åé‡æ–°æ„å»º"
            make clean
            make -j"$PARALLEL_JOBS"
        fi
    else
        echo "âš¡ æ— éœ€é‡æ–°ç¼–è¯‘"
    fi
}
```

---

## 9. ğŸ“Š æ„å»ºæŠ¥å‘Šç”Ÿæˆ



### 9.1 æ„å»ºä¿¡æ¯æ”¶é›†



**ğŸ“‹ è¯¦ç»†ä¿¡æ¯è®°å½•**
```bash
generate_build_info() {
    local report_file="build_report_$(date +%Y%m%d_%H%M%S).txt"
    
    echo "ğŸ“Š ç”Ÿæˆæ„å»ºæŠ¥å‘Š: $report_file"
    
    {
        echo "==============================================="
        echo "           æ„å»ºæŠ¥å‘Š"
        echo "==============================================="
        echo "é¡¹ç›®åç§°: $PROJECT_NAME"
        echo "æ„å»ºæ—¶é—´: $(date)"
        echo "æ„å»ºç¯å¢ƒ: $(uname -a)"
        echo "ç¼–è¯‘å™¨ç‰ˆæœ¬: $(gcc --version | head -1)"
        echo "Makeç‰ˆæœ¬: $(make --version | head -1)"
        echo ""
        
        echo "æ„å»ºé…ç½®:"
        echo "  æ„å»ºç±»å‹: $BUILD_TYPE"
        echo "  å¹¶è¡Œä»»åŠ¡: $PARALLEL_JOBS"
        echo "  å®‰è£…è·¯å¾„: $INSTALL_PREFIX"
        echo ""
        
        if [[ -f "build.log" ]]; then
            echo "æ„å»ºæ—¥å¿—æ‘˜è¦:"
            echo "  ç¼–è¯‘è­¦å‘Š: $(grep -c "warning:" build.log || echo 0)"
            echo "  ç¼–è¯‘é”™è¯¯: $(grep -c "error:" build.log || echo 0)"
        fi
        
    } > "$report_file"
    
    echo "âœ… æ„å»ºæŠ¥å‘Šå·²ç”Ÿæˆ"
}
```

### 9.2 æ„å»ºç»Ÿè®¡åˆ†æ



**ğŸ“ˆ æ„å»ºæ•°æ®åˆ†æ**
```bash
analyze_build_stats() {
    echo "ğŸ“ˆ åˆ†ææ„å»ºç»Ÿè®¡ä¿¡æ¯..."
    
    if [[ -f "build.log" ]]; then
        echo "ğŸ“Š æ„å»ºç»Ÿè®¡:"
        
#        # ç¼–è¯‘æ–‡ä»¶ç»Ÿè®¡
        local compiled_files=$(grep -c "\.c\|\.cpp" build.log || echo 0)
        echo "  ç¼–è¯‘æ–‡ä»¶æ•°: $compiled_files"
        
#        # é“¾æ¥åº“ç»Ÿè®¡
        local linked_libs=$(grep -o "\-l[a-zA-Z0-9_]*" build.log | sort -u | wc -l)
        echo "  é“¾æ¥åº“æ•°é‡: $linked_libs"
        
#        # æ„å»ºæ—¶é—´åˆ†æ
        if [[ -f ".build_start_time" ]]; then
            local start_time=$(cat .build_start_time)
            local end_time=$(date +%s)
            local total_time=$((end_time - start_time))
            
            echo "  æ€»æ„å»ºæ—¶é—´: ${total_time}ç§’"
            
#            # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            rm -f .build_start_time
        fi
    fi
}
```

### 9.3 æ„å»ºç»“æœå±•ç¤º



**ğŸ¯ ç»“æœæ±‡æ€»æ˜¾ç¤º**
```bash
show_build_summary() {
    echo ""
    echo "ğŸ‰ ================= æ„å»ºå®Œæˆ =================="
    echo ""
    
#    # æ˜¾ç¤ºç”Ÿæˆçš„ä¸»è¦æ–‡ä»¶
    echo "ğŸ“¦ æ„å»ºäº§ç‰©:"
    find . -name "*.so" -o -name "*.a" -o -path "./bin/*" -type f | head -10 | while read -r file; do
        local size=$(ls -lh "$file" | awk '{print $5}')
        echo "   $file ($size)"
    done
    
#    # æ˜¾ç¤ºå®‰è£…è¯´æ˜
    echo ""
    echo "ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ:"
    echo "   ğŸ”¹ è¿è¡Œæµ‹è¯•: make test"
    echo "   ğŸ”¹ å®‰è£…ç¨‹åº: make install"
    echo "   ğŸ”¹ æŸ¥çœ‹å¸®åŠ©: ./bin/myapp --help"
    
#    # æ˜¾ç¤ºç›¸å…³æ–‡æ¡£
    if [[ -f "README.md" ]]; then
        echo "   ğŸ”¹ é˜…è¯»æ–‡æ¡£: cat README.md"
    fi
    
    echo ""
    echo "âœ… æ„å»ºæˆåŠŸå®Œæˆï¼"
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ æ„å»ºè„šæœ¬æœ¬è´¨ï¼šæŠŠå¤æ‚ç¼–è¯‘è¿‡ç¨‹è‡ªåŠ¨åŒ–çš„Shellè„šæœ¬
ğŸ”¸ ç¯å¢ƒæ£€æŸ¥ï¼šç¡®ä¿ç³»ç»Ÿå…·å¤‡ç¼–è¯‘æ‰€éœ€çš„å·¥å…·å’Œä¾èµ–
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šå½“æ„å»ºå¤±è´¥æ—¶èƒ½å¤Ÿæ¸…ç†å’Œå›æ»š
ğŸ”¸ å¹¶è¡Œç¼–è¯‘ï¼šåˆ©ç”¨å¤šæ ¸CPUåŠ é€Ÿç¼–è¯‘è¿‡ç¨‹
ğŸ”¸ å¢é‡ç¼–è¯‘ï¼šåªç¼–è¯‘å˜æ›´çš„æ–‡ä»¶ï¼ŒèŠ‚çœæ—¶é—´
ğŸ”¸ æ„å»ºç¼“å­˜ï¼šå¤ç”¨ç¼–è¯‘ç»“æœï¼Œè¿›ä¸€æ­¥æå‡é€Ÿåº¦
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦æ„å»ºè„šæœ¬**
```
æ‰‹åŠ¨ç¼–è¯‘çš„é—®é¢˜ï¼š
- æ­¥éª¤å¤æ‚å®¹æ˜“å‡ºé”™
- ç¯å¢ƒé…ç½®éš¾ä»¥é‡å¤
- æ— æ³•æ‰¹é‡å¤„ç†

æ„å»ºè„šæœ¬çš„ä»·å€¼ï¼š
- ä¸€é”®å®Œæˆå¤æ‚æµç¨‹
- æ ‡å‡†åŒ–ç¼–è¯‘ç¯å¢ƒ  
- æ”¯æŒæŒç»­é›†æˆ
```

**ğŸ”¹ æ„å»ºè„šæœ¬è®¾è®¡åŸåˆ™**
```
å¯è¯»æ€§ï¼šä»£ç æ³¨é‡Šæ¸…æ™°ï¼Œé€»è¾‘åˆ†æ˜
å¯é æ€§ï¼šé”™è¯¯å¤„ç†å®Œå–„ï¼Œæœ‰å›æ»šæœºåˆ¶
å¯é…ç½®ï¼šæ”¯æŒå‚æ•°è°ƒæ•´ï¼Œé€‚åº”ä¸åŒç¯å¢ƒ
å¯æ‰©å±•ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåŠŸèƒ½æ·»åŠ 
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ å¼€å‘åœºæ™¯åº”ç”¨**
- **æ—¥å¸¸å¼€å‘**ï¼šå¿«é€Ÿç¼–è¯‘æµ‹è¯•ä»£ç 
- **ç‰ˆæœ¬å‘å¸ƒ**ï¼šè‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒæµç¨‹  
- **å›¢é˜Ÿåä½œ**ï¼šç»Ÿä¸€çš„æ„å»ºç¯å¢ƒ
- **æŒç»­é›†æˆ**ï¼šè‡ªåŠ¨åŒ–CI/CDæµæ°´çº¿

**ğŸ› ï¸ æœ€ä½³å®è·µå»ºè®®**
```
è„šæœ¬ç»“æ„ï¼š
- ä½¿ç”¨set -euo pipefailä¸¥æ ¼æ¨¡å¼
- æ¯ä¸ªåŠŸèƒ½å†™æˆç‹¬ç«‹å‡½æ•°
- æ·»åŠ è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯

é”™è¯¯å¤„ç†ï¼š
- å…³é”®æ­¥éª¤éƒ½è¦æ£€æŸ¥è¿”å›å€¼
- å¤±è´¥æ—¶ç»™å‡ºæ˜ç¡®çš„è§£å†³å»ºè®®
- é‡è¦æ–‡ä»¶è®°å¾—å¤‡ä»½

æ€§èƒ½ä¼˜åŒ–ï¼š
- è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•°
- å¯ç”¨ç¼–è¯‘ç¼“å­˜(ccache)
- æ”¯æŒå¢é‡ç¼–è¯‘
```

### 10.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



- [ ] èƒ½å¤Ÿç¼–å†™åŸºç¡€çš„æ„å»ºè„šæœ¬
- [ ] ç†è§£ç¯å¢ƒæ£€æŸ¥çš„é‡è¦æ€§
- [ ] æŒæ¡é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶
- [ ] ä¼šé…ç½®å¹¶è¡Œç¼–è¯‘
- [ ] äº†è§£å¢é‡ç¼–è¯‘åŸç†
- [ ] èƒ½ç”Ÿæˆæ„å»ºæŠ¥å‘Š

**ğŸ”‘ æ ¸å¿ƒè®°å¿†å£è¯€**
> æ„å»ºè„šæœ¬è‡ªåŠ¨åŒ–ï¼Œç¯å¢ƒæ£€æŸ¥ç¬¬ä¸€å…³
> é”™è¯¯å¤„ç†è¦å®Œå–„ï¼Œå¹¶è¡Œç¼–è¯‘é€Ÿåº¦å¿«  
> ç¼“å­˜å¢é‡çœæ—¶é—´ï¼ŒæŠ¥å‘Šæ€»ç»“å¾ˆé‡è¦

