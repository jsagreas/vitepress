---
title: 9ã€systemdå®šæ—¶å™¨ä¸è®¡åˆ’ä»»åŠ¡
---
## ğŸ“š ç›®å½•

1. [systemdå®šæ—¶å™¨åŸºç¡€æ¦‚å¿µ](#1-systemdå®šæ—¶å™¨åŸºç¡€æ¦‚å¿µ)
2. [timerå•å…ƒæ–‡ä»¶é…ç½®è¯¦è§£](#2-timerå•å…ƒæ–‡ä»¶é…ç½®è¯¦è§£)
3. [æ—¶é—´è¡¨è¾¾å¼ä¸è§¦å‘æ–¹å¼](#3-æ—¶é—´è¡¨è¾¾å¼ä¸è§¦å‘æ–¹å¼)
4. [å®šæ—¶å™¨ä¸æœåŠ¡å…³è”æœºåˆ¶](#4-å®šæ—¶å™¨ä¸æœåŠ¡å…³è”æœºåˆ¶)
5. [å®šæ—¶å™¨çŠ¶æ€ç›‘æ§ä¸ç®¡ç†](#5-å®šæ—¶å™¨çŠ¶æ€ç›‘æ§ä¸ç®¡ç†)
6. [cron vs systemd timerå¯¹æ¯”](#6-cron-vs-systemd-timerå¯¹æ¯”)
7. [æ•…éšœæ’æŸ¥ä¸æœ€ä½³å®è·µ](#7-æ•…éšœæ’æŸ¥ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. â° systemdå®šæ—¶å™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯systemdå®šæ—¶å™¨


**ç®€å•ç†è§£**ï¼šsystemdå®šæ—¶å™¨å°±æ˜¯ç°ä»£Linuxç³»ç»Ÿä¸­çš„"é—¹é’Ÿ"ï¼Œå¯ä»¥è®©ç³»ç»Ÿåœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚

```
ä¼ ç»Ÿæ–¹å¼ vs systemdå®šæ—¶å™¨ï¼š

ä¼ ç»Ÿcronï¼š
åˆ† æ—¶ æ—¥ æœˆ å‘¨ å‘½ä»¤
0  2  *  *  *  /backup.sh

systemdå®šæ—¶å™¨ï¼š
timeræ–‡ä»¶ + serviceæ–‡ä»¶
æ›´çµæ´»ã€æ›´å¼ºå¤§ã€æ›´å¥½ç®¡ç†
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **ç»Ÿä¸€ç®¡ç†**ï¼šä¸å…¶ä»–ç³»ç»ŸæœåŠ¡é›†æˆï¼Œç»Ÿä¸€ç”¨systemctlç®¡ç†
- **ä¾èµ–æ§åˆ¶**ï¼šå¯ä»¥è®¾ç½®æœåŠ¡ä¾èµ–å…³ç³»
- **æ—¥å¿—é›†æˆ**ï¼šä»»åŠ¡æ‰§è¡Œæ—¥å¿—è‡ªåŠ¨è®°å½•åˆ°journald
- **çŠ¶æ€ç›‘æ§**ï¼šå¯ä»¥æŸ¥çœ‹å®šæ—¶å™¨çŠ¶æ€å’Œæ‰§è¡Œå†å²
- **çµæ´»è§¦å‘**ï¼šæ”¯æŒå¤šç§è§¦å‘æ¡ä»¶ï¼Œä¸åªæ˜¯æ—¶é—´

### 1.2 å®šæ—¶å™¨å·¥ä½œåŸç†


**åŸºæœ¬å·¥ä½œæµç¨‹**ï¼š
```
ç³»ç»Ÿå¯åŠ¨
    â†“
systemdåŠ è½½.timeræ–‡ä»¶
    â†“
æ ¹æ®æ—¶é—´é…ç½®è®¾ç½®è§¦å‘å™¨
    â†“
åˆ°è¾¾è§¦å‘æ—¶é—´
    â†“
è‡ªåŠ¨å¯åŠ¨å¯¹åº”çš„.serviceæ–‡ä»¶
    â†“
æœåŠ¡æ‰§è¡Œå®Œæˆï¼Œç­‰å¾…ä¸‹æ¬¡è§¦å‘
```

### 1.3 å®šæ—¶å™¨æ–‡ä»¶ç»“æ„


**æ–‡ä»¶å‘½åè§„åˆ™**ï¼š
- **å®šæ—¶å™¨æ–‡ä»¶**ï¼š`ä»»åŠ¡å.timer`
- **æœåŠ¡æ–‡ä»¶**ï¼š`ä»»åŠ¡å.service`
- **å­˜æ”¾ä½ç½®**ï¼š`/etc/systemd/system/` æˆ– `/lib/systemd/system/`

> ğŸ’¡ **é‡è¦ç†è§£**ï¼šå®šæ—¶å™¨æ–‡ä»¶åªè´Ÿè´£"ä½•æ—¶æ‰§è¡Œ"ï¼Œå…·ä½“"æ‰§è¡Œä»€ä¹ˆ"ç”±å¯¹åº”çš„serviceæ–‡ä»¶å®šä¹‰

---

## 2. ğŸ“ timerå•å…ƒæ–‡ä»¶é…ç½®è¯¦è§£


### 2.1 åŸºæœ¬é…ç½®ç»“æ„


ä¸€ä¸ªå®Œæ•´çš„timeræ–‡ä»¶åŒ…å«ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š

```ini
# backup.timer ç¤ºä¾‹
[Unit]
Description=æ¯æ—¥å¤‡ä»½å®šæ—¶å™¨
Requires=backup.service

[Timer]
OnCalendar=daily
Persistent=true
RandomizedDelaySec=30min

[Install]
WantedBy=timers.target
```

### 2.2 [Unit]æ®µé…ç½®è¯¦è§£


**Description**ï¼šå®šæ—¶å™¨æè¿°ä¿¡æ¯
```ini
Description=æ¯æ—¥æ•°æ®åº“å¤‡ä»½å®šæ—¶å™¨
```

**Requires/Wants**ï¼šä¾èµ–å…³ç³»
```ini
# å¼ºä¾èµ–ï¼šå¿…é¡»å­˜åœ¨å¯¹åº”çš„serviceæ–‡ä»¶
Requires=backup.service

# å¼±ä¾èµ–ï¼šæ¨èä½†éå¿…éœ€
Wants=network.target
```

**After/Before**ï¼šå¯åŠ¨é¡ºåº
```ini
# åœ¨ç½‘ç»œæœåŠ¡å¯åŠ¨åå†å¯åŠ¨å®šæ—¶å™¨
After=network.target
```

### 2.3 [Timer]æ®µæ ¸å¿ƒé…ç½®


**OnCalendar**ï¼šåŸºäºæ—¥å†çš„å®šæ—¶è§¦å‘
```ini
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
OnCalendar=*-*-* 02:00:00

# æ¯å‘¨ä¸€ä¸Šåˆ9ç‚¹æ‰§è¡Œ
OnCalendar=Mon 09:00:00

# æ¯æœˆ1å·æ‰§è¡Œ
OnCalendar=*-*-01 00:00:00
```

**OnBootSec**ï¼šç³»ç»Ÿå¯åŠ¨åçš„ç›¸å¯¹æ—¶é—´
```ini
# ç³»ç»Ÿå¯åŠ¨15åˆ†é’Ÿåæ‰§è¡Œ
OnBootSec=15min

# ç³»ç»Ÿå¯åŠ¨2å°æ—¶åæ‰§è¡Œ
OnBootSec=2h
```

**OnUnitActiveSec**ï¼šç›¸å¯¹äºä¸Šæ¬¡æ¿€æ´»çš„æ—¶é—´
```ini
# ä¸Šæ¬¡æ‰§è¡Œå1å°æ—¶å†æ¬¡æ‰§è¡Œ
OnUnitActiveSec=1h

# åˆ›å»ºå‘¨æœŸæ€§ä»»åŠ¡
OnUnitActiveSec=30min
```

**Persistent**ï¼šæŒä¹…åŒ–å®šæ—¶å™¨
```ini
# å¯ç”¨æŒä¹…åŒ–ï¼šå¦‚æœé”™è¿‡æ‰§è¡Œæ—¶é—´ä¼šç«‹å³è¡¥æ‰§è¡Œ
Persistent=true

# ç¦ç”¨æŒä¹…åŒ–ï¼šé”™è¿‡å°±é”™è¿‡äº†
Persistent=false
```

**RandomizedDelaySec**ï¼šéšæœºå»¶è¿Ÿ
```ini
# åœ¨è§¦å‘æ—¶é—´åŸºç¡€ä¸Šéšæœºå»¶è¿Ÿ0-30åˆ†é’Ÿ
RandomizedDelaySec=30min
```

### 2.4 [Install]æ®µé…ç½®


```ini
[Install]
# å®‰è£…åˆ°timers.targetï¼Œç¡®ä¿ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½
WantedBy=timers.target
```

---

## 3. ğŸ• æ—¶é—´è¡¨è¾¾å¼ä¸è§¦å‘æ–¹å¼


### 3.1 OnCalendaræ—¶é—´è¡¨è¾¾å¼è¯¦è§£


**åŸºæœ¬æ ¼å¼**ï¼š`DayOfWeek Year-Month-Day Hour:Minute:Second`

**æ—¶é—´å­—æ®µè¯´æ˜**ï¼š
```
å­—æ®µé¡ºåºï¼šæ˜ŸæœŸ å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’
é€šé…ç¬¦ï¼š* è¡¨ç¤ºä»»æ„å€¼
èŒƒå›´ï¼š.. è¡¨ç¤ºèŒƒå›´ï¼ˆå¦‚1..5è¡¨ç¤º1åˆ°5ï¼‰
åˆ—è¡¨ï¼š, è¡¨ç¤ºå¤šä¸ªå€¼ï¼ˆå¦‚1,3,5ï¼‰
é—´éš”ï¼š/ è¡¨ç¤ºé—´éš”ï¼ˆå¦‚*/2è¡¨ç¤ºæ¯2ä¸ªï¼‰
```

### 3.2 å¸¸ç”¨æ—¶é—´è¡¨è¾¾å¼ç¤ºä¾‹


**æ¯æ—¥å®šæ—¶**ï¼š
```ini
# æ¯å¤©å‡Œæ™¨2ç‚¹
OnCalendar=*-*-* 02:00:00
# ç®€åŒ–å†™æ³•
OnCalendar=daily
OnCalendar=02:00
```

**æ¯å‘¨å®šæ—¶**ï¼š
```ini
# æ¯å‘¨ä¸€ä¸Šåˆ9ç‚¹
OnCalendar=Mon 09:00:00
# æ¯å‘¨äº”ä¸‹åˆ5ç‚¹
OnCalendar=Fri 17:00:00
# å·¥ä½œæ—¥ä¸Šåˆ8ç‚¹
OnCalendar=Mon..Fri 08:00:00
```

**æ¯æœˆå®šæ—¶**ï¼š
```ini
# æ¯æœˆ1å·å‡Œæ™¨1ç‚¹
OnCalendar=*-*-01 01:00:00
# æ¯æœˆæœ€åä¸€å¤©
OnCalendar=*-*~01 23:59:00
# æ¯å­£åº¦ç¬¬ä¸€å¤©
OnCalendar=*-01,04,07,10-01 00:00:00
```

**å¤æ‚è¡¨è¾¾å¼**ï¼š
```ini
# å·¥ä½œæ—¥æ¯2å°æ—¶
OnCalendar=Mon..Fri *:00:00/2h
# æ¯å¹´ç”Ÿæ—¥æé†’
OnCalendar=*-06-15 08:00:00
# æ¯15åˆ†é’Ÿæ‰§è¡Œ
OnCalendar=*:00,15,30,45
```

### 3.3 ç›¸å¯¹æ—¶é—´è§¦å‘


**OnBootSecç¤ºä¾‹**ï¼š
```ini
# å¼€æœºåæ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–
OnBootSec=5min

# é…åˆOnUnitActiveSecåˆ›å»ºå‘¨æœŸä»»åŠ¡
OnBootSec=10min
OnUnitActiveSec=1h
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
- **ç³»ç»Ÿåˆå§‹åŒ–**ï¼šå¼€æœºåæ£€æŸ¥ç³»ç»ŸçŠ¶æ€
- **å‘¨æœŸç›‘æ§**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
- **èµ„æºæ¸…ç†**ï¼šå®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶

---

## 4. ğŸ”— å®šæ—¶å™¨ä¸æœåŠ¡å…³è”æœºåˆ¶


### 4.1 å…³è”è§„åˆ™


**é»˜è®¤å…³è”**ï¼šå®šæ—¶å™¨ä¼šè‡ªåŠ¨å¯»æ‰¾åŒåçš„serviceæ–‡ä»¶
```bash
# æ–‡ä»¶é…å¯¹
backup.timer  â†’  backup.service
cleanup.timer â†’  cleanup.service
```

**æ‰‹åŠ¨æŒ‡å®šå…³è”**ï¼š
```ini
# åœ¨timeræ–‡ä»¶ä¸­æŒ‡å®š
[Timer]
Unit=my-custom-backup.service
```

### 4.2 åˆ›å»ºå®Œæ•´çš„å®šæ—¶ä»»åŠ¡


**æ­¥éª¤1ï¼šåˆ›å»ºserviceæ–‡ä»¶**
```ini
# /etc/systemd/system/backup.service
[Unit]
Description=æ•°æ®åº“å¤‡ä»½æœåŠ¡
After=network.target

[Service]
Type=oneshot
User=backup
ExecStart=/usr/local/bin/backup.sh
StandardOutput=journal
StandardError=journal
```

**æ­¥éª¤2ï¼šåˆ›å»ºtimeræ–‡ä»¶**
```ini
# /etc/systemd/system/backup.timer
[Unit]
Description=æ¯æ—¥å¤‡ä»½å®šæ—¶å™¨
Requires=backup.service

[Timer]
OnCalendar=daily
Persistent=true
RandomizedDelaySec=10min

[Install]
WantedBy=timers.target
```

**æ­¥éª¤3ï¼šå¯ç”¨å’Œå¯åŠ¨**
```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯ç”¨å®šæ—¶å™¨ï¼ˆå¼€æœºè‡ªå¯ï¼‰
sudo systemctl enable backup.timer

# å¯åŠ¨å®šæ—¶å™¨
sudo systemctl start backup.timer

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status backup.timer
```

### 4.3 æœåŠ¡æ–‡ä»¶è¦ç‚¹


**Type=oneshot**ï¼šä¸€æ¬¡æ€§æ‰§è¡Œç±»å‹
```ini
[Service]
Type=oneshot
# è¿™ç§ç±»å‹é€‚åˆå®šæ—¶ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå°±ç»“æŸ
```

**ç”¨æˆ·æƒé™**ï¼š
```ini
[Service]
User=backup
Group=backup
# ä»¥ç‰¹å®šç”¨æˆ·èº«ä»½è¿è¡Œï¼Œæé«˜å®‰å…¨æ€§
```

**ç¯å¢ƒå˜é‡**ï¼š
```ini
[Service]
Environment="PATH=/usr/local/bin:/usr/bin:/bin"
EnvironmentFile=/etc/backup/config
# è®¾ç½®æ‰§è¡Œç¯å¢ƒ
```

---

## 5. ğŸ“Š å®šæ—¶å™¨çŠ¶æ€ç›‘æ§ä¸ç®¡ç†


### 5.1 åŸºæœ¬ç›‘æ§å‘½ä»¤


**æŸ¥çœ‹æ‰€æœ‰å®šæ—¶å™¨**ï¼š
```bash
# åˆ—å‡ºæ‰€æœ‰å®šæ—¶å™¨åŠçŠ¶æ€
systemctl list-timers

# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
systemctl list-timers --all
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
NEXT                        LEFT     LAST PASSED UNIT         ACTIVATES
Sun 2024-03-17 02:00:00 CST 8h left  n/a  n/a    backup.timer backup.service
```

**å­—æ®µå«ä¹‰**ï¼š
- **NEXT**ï¼šä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
- **LEFT**ï¼šè·ç¦»ä¸‹æ¬¡æ‰§è¡Œçš„æ—¶é—´
- **LAST**ï¼šä¸Šæ¬¡æ‰§è¡Œæ—¶é—´
- **PASSED**ï¼šè·ç¦»ä¸Šæ¬¡æ‰§è¡Œè¿‡äº†å¤šé•¿æ—¶é—´

### 5.2 å•ä¸ªå®šæ—¶å™¨ç®¡ç†


**æŸ¥çœ‹å®šæ—¶å™¨çŠ¶æ€**ï¼š
```bash
# è¯¦ç»†çŠ¶æ€ä¿¡æ¯
systemctl status backup.timer

# æŸ¥çœ‹é…ç½®
systemctl show backup.timer

# æŸ¥çœ‹å±æ€§
systemctl show backup.timer -p NextElapseUSecRealtime
```

**å¯åŠ¨å’Œåœæ­¢**ï¼š
```bash
# å¯åŠ¨å®šæ—¶å™¨
sudo systemctl start backup.timer

# åœæ­¢å®šæ—¶å™¨
sudo systemctl stop backup.timer

# é‡å¯å®šæ—¶å™¨
sudo systemctl restart backup.timer

# ç«‹å³æ‰§è¡Œä¸€æ¬¡
sudo systemctl start backup.service
```

### 5.3 æ—¥å¿—ç›‘æ§


**æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—**ï¼š
```bash
# æŸ¥çœ‹å®šæ—¶å™¨æ—¥å¿—
journalctl -u backup.timer

# æŸ¥çœ‹å¯¹åº”æœåŠ¡æ—¥å¿—
journalctl -u backup.service

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
journalctl -u backup.service -f

# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
journalctl -u backup.service --since today
```

**æ—¥å¿—åˆ†æç¤ºä¾‹**ï¼š
```
Mar 17 02:00:01 server systemd[1]: Started æ•°æ®åº“å¤‡ä»½æœåŠ¡.
Mar 17 02:05:23 server backup.sh[1234]: å¤‡ä»½å®Œæˆï¼Œæ–‡ä»¶ä¿å­˜åˆ° /backup/db_20240317.sql
Mar 17 02:05:24 server systemd[1]: backup.service: Succeeded.
```

---

## 6. ğŸ†š cron vs systemd timerå¯¹æ¯”


### 6.1 åŠŸèƒ½å¯¹æ¯”è¡¨


| ç‰¹æ€§ | **cron** | **systemd timer** |
|------|----------|-------------------|
| ğŸ“ **é…ç½®æ–¹å¼** | `crontabæ–‡ä»¶` | `timer+serviceæ–‡ä»¶` |
| ğŸ”§ **ç®¡ç†å·¥å…·** | `crontabå‘½ä»¤` | `systemctlå‘½ä»¤` |
| ğŸ“Š **çŠ¶æ€ç›‘æ§** | âŒ éš¾ä»¥ç›‘æ§ | âœ… è¯¦ç»†çŠ¶æ€ä¿¡æ¯ |
| ğŸ“‹ **æ—¥å¿—è®°å½•** | âŒ éœ€è¦æ‰‹åŠ¨é…ç½® | âœ… è‡ªåŠ¨é›†æˆjournald |
| ğŸ”— **ä¾èµ–ç®¡ç†** | âŒ ä¸æ”¯æŒ | âœ… å®Œæ•´ä¾èµ–ç³»ç»Ÿ |
| âš¡ **ç³»ç»Ÿé›†æˆ** | âŒ ç‹¬ç«‹è¿è¡Œ | âœ… å®Œå…¨é›†æˆsystemd |
| ğŸ› ï¸ **é”™è¿‡è¡¥å¿** | âŒ ä¸æ”¯æŒ | âœ… Persistenté€‰é¡¹ |
| ğŸ“ˆ **èµ„æºæ§åˆ¶** | âŒ æœ‰é™ | âœ… å®Œæ•´cgroupæ”¯æŒ |

### 6.2 ä½¿ç”¨åœºæ™¯å¯¹æ¯”


**é€‚åˆç”¨cronçš„åœºæ™¯**ï¼š
```
âœ… ç®€å•çš„å®šæ—¶ä»»åŠ¡
âœ… ä¼ ç»Ÿè„šæœ¬è¿ç§»
âœ… ç”¨æˆ·çº§åˆ«çš„ä¸ªäººä»»åŠ¡
âœ… å¯¹systemdä¸ç†Ÿæ‚‰çš„ç¯å¢ƒ
```

**é€‚åˆç”¨systemd timerçš„åœºæ™¯**ï¼š
```
âœ… ç³»ç»Ÿçº§æœåŠ¡
âœ… éœ€è¦ä¾èµ–ç®¡ç†
âœ… è¦æ±‚è¯¦ç»†ç›‘æ§
âœ… å¤æ‚çš„æ‰§è¡Œç¯å¢ƒ
âœ… ç°ä»£åŒ–çš„ç³»ç»Ÿç®¡ç†
```

### 6.3 è¿ç§»ç¤ºä¾‹


**ä»cronè¿ç§»åˆ°systemd timer**ï¼š

**åŸcroné…ç½®**ï¼š
```bash
# æ¯å¤©2ç‚¹å¤‡ä»½æ•°æ®åº“
0 2 * * * /usr/local/bin/backup.sh
```

**è¿ç§»åçš„systemdé…ç½®**ï¼š

Serviceæ–‡ä»¶ï¼š
```ini
# backup.service
[Unit]
Description=æ•°æ®åº“å¤‡ä»½
After=network.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/backup.sh
User=backup
StandardOutput=journal
```

Timeræ–‡ä»¶ï¼š
```ini
# backup.timer
[Unit]
Description=æ¯æ—¥å¤‡ä»½å®šæ—¶å™¨

[Timer]
OnCalendar=02:00:00
Persistent=true

[Install]
WantedBy=timers.target
```

---

## 7. ğŸ”§ æ•…éšœæ’æŸ¥ä¸æœ€ä½³å®è·µ


### 7.1 å¸¸è§é—®é¢˜è¯Šæ–­


**é—®é¢˜1ï¼šå®šæ—¶å™¨ä¸æ‰§è¡Œ**

ğŸ” **æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥å®šæ—¶å™¨çŠ¶æ€
systemctl status mytask.timer

# 2. æ£€æŸ¥æ˜¯å¦å¯ç”¨
systemctl is-enabled mytask.timer

# 3. æ£€æŸ¥ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
systemctl list-timers mytask.timer

# 4. æ£€æŸ¥æœåŠ¡æ–‡ä»¶æ˜¯å¦å­˜åœ¨
systemctl status mytask.service
```

**é—®é¢˜2ï¼šä»»åŠ¡æ‰§è¡Œå¤±è´¥**

ğŸ” **æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—
journalctl -u mytask.service --since "1 hour ago"

# 2. æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•
sudo systemctl start mytask.service

# 3. æ£€æŸ¥æƒé™é—®é¢˜
ls -la /path/to/script

# 4. æ£€æŸ¥ç¯å¢ƒå˜é‡
systemctl show mytask.service -p Environment
```

### 7.2 è°ƒè¯•æŠ€å·§


**æµ‹è¯•æ—¶é—´è¡¨è¾¾å¼**ï¼š
```bash
# éªŒè¯æ—¶é—´è¡¨è¾¾å¼æ˜¯å¦æ­£ç¡®
systemd-analyze calendar "Mon..Fri 08:00"

# æŸ¥çœ‹ä¸‹æ¬¡è§¦å‘æ—¶é—´
systemd-analyze calendar "daily" --iterations=5
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
  Original form: daily
Normalized form: *-*-* 00:00:00
    Next elapse: Sun 2024-03-17 00:00:00 CST
       (in UTC): Sat 2024-03-16 16:00:00 UTC
```

**å•æ­¥è°ƒè¯•**ï¼š
```bash
# 1. åœæ­¢å®šæ—¶å™¨
sudo systemctl stop mytask.timer

# 2. æ‰‹åŠ¨æ‰§è¡ŒæœåŠ¡æŸ¥çœ‹è¾“å‡º
sudo systemctl start mytask.service

# 3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
journalctl -u mytask.service -n 50
```

### 7.3 æœ€ä½³å®è·µ


**1. æ–‡ä»¶å‘½åè§„èŒƒ**
```bash
# ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
database-backup.timer
log-cleanup.timer
system-health-check.timer
```

**2. æƒé™æœ€å°åŒ–åŸåˆ™**
```ini
[Service]
User=taskuser
Group=taskgroup
# ä¸è¦ä½¿ç”¨rooté™¤éç»å¯¹å¿…è¦
```

**3. é”™è¯¯å¤„ç†**
```ini
[Service]
Type=oneshot
ExecStart=/usr/local/bin/mytask.sh
# å¤±è´¥æ—¶é‡å¯ç­–ç•¥
Restart=on-failure
RestartSec=300
```

**4. æ—¥å¿—é…ç½®**
```ini
[Service]
StandardOutput=journal
StandardError=journal
SyslogIdentifier=mytask
# ä¾¿äºæ—¥å¿—æŸ¥æ‰¾å’Œåˆ†æ
```

**5. æ—¶é—´é…ç½®å»ºè®®**
```ini
[Timer]
OnCalendar=02:00:00
# ä½¿ç”¨éšæœºå»¶è¿Ÿé¿å…ç³»ç»Ÿè´Ÿè½½å³°å€¼
RandomizedDelaySec=30min
# å¯ç”¨æŒä¹…åŒ–ç¡®ä¿ä»»åŠ¡æ‰§è¡Œ
Persistent=true
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ systemdå®šæ—¶å™¨ = timeræ–‡ä»¶ + serviceæ–‡ä»¶
ğŸ”¸ timerè´Ÿè´£"ä½•æ—¶æ‰§è¡Œ"ï¼Œserviceè´Ÿè´£"æ‰§è¡Œä»€ä¹ˆ"
ğŸ”¸ OnCalendarç”¨äºåŸºäºæ—¶é—´çš„å®šæ—¶ï¼ŒOnBootSecç”¨äºç›¸å¯¹æ—¶é—´
ğŸ”¸ Persistent=trueç¡®ä¿é”™è¿‡çš„ä»»åŠ¡ä¼šè¡¥æ‰§è¡Œ
ğŸ”¸ å®šæ—¶å™¨éœ€è¦enableå’Œstartæ‰èƒ½ç”Ÿæ•ˆ
```

### 8.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ æ—¶é—´è¡¨è¾¾å¼è§„åˆ™**
```
æ ¼å¼ï¼šDayOfWeek Year-Month-Day Hour:Minute:Second
å¸¸ç”¨ï¼šdaily, weekly, monthly
èŒƒå›´ï¼šMon..Fri (å‘¨ä¸€åˆ°å‘¨äº”)
åˆ—è¡¨ï¼š1,15 (1å·å’Œ15å·)
é—´éš”ï¼š*/2h (æ¯2å°æ—¶)
```

**ğŸ”¹ æœåŠ¡é…ç½®è¦ç‚¹**
```
Type=oneshotï¼šä¸€æ¬¡æ€§æ‰§è¡Œä»»åŠ¡
User/Groupï¼šæŒ‡å®šè¿è¡Œç”¨æˆ·
StandardOutput=journalï¼šæ—¥å¿—è¾“å‡ºé…ç½®
ExecStartï¼šå…·ä½“æ‰§è¡Œçš„å‘½ä»¤
```

**ğŸ”¹ ç®¡ç†å‘½ä»¤**
```
systemctl list-timersï¼šæŸ¥çœ‹æ‰€æœ‰å®šæ—¶å™¨
systemctl status xxx.timerï¼šæŸ¥çœ‹å®šæ—¶å™¨çŠ¶æ€
journalctl -u xxx.serviceï¼šæŸ¥çœ‹æ‰§è¡Œæ—¥å¿—
systemd-analyze calendarï¼šæµ‹è¯•æ—¶é—´è¡¨è¾¾å¼
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ç³»ç»Ÿç»´æŠ¤è‡ªåŠ¨åŒ–**ï¼š
- å®šæœŸå¤‡ä»½æ•°æ®åº“å’Œæ–‡ä»¶
- è‡ªåŠ¨æ¸…ç†æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶
- ç³»ç»Ÿå¥åº·æ£€æŸ¥å’ŒæŠ¥å‘Š

**ç›‘æ§å’ŒæŠ¥è­¦**ï¼š
- å®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€
- ç£ç›˜ç©ºé—´ç›‘æ§
- æ€§èƒ½æ•°æ®æ”¶é›†

**ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–**ï¼š
- å®šæœŸæ•°æ®åŒæ­¥
- æŠ¥è¡¨è‡ªåŠ¨ç”Ÿæˆ
- ç¼“å­˜é¢„çƒ­ä»»åŠ¡

### 8.4 å­¦ä¹ å»ºè®®


**å¾ªåºæ¸è¿›**ï¼š
1. å…ˆæŒæ¡åŸºæœ¬çš„timerå’Œserviceæ–‡ä»¶ç¼–å†™
2. ç†Ÿç»ƒä½¿ç”¨systemctlç®¡ç†å®šæ—¶å™¨
3. å­¦ä¼šæŸ¥çœ‹æ—¥å¿—å’Œæ’æŸ¥é—®é¢˜
4. æœ€åæŒæ¡å¤æ‚çš„æ—¶é—´è¡¨è¾¾å¼å’Œé«˜çº§ç‰¹æ€§

**å®è·µæ–¹æ³•**ï¼š
- ä»ç®€å•çš„æ¯åˆ†é’Ÿæ‰§è¡Œå¼€å§‹ç»ƒä¹ 
- åˆ›å»ºå®é™…æœ‰ç”¨çš„ä»»åŠ¡ï¼ˆå¦‚ç³»ç»Ÿç›‘æ§ï¼‰
- å­¦ä¼šé˜…è¯»å’Œåˆ†ææ—¥å¿—è¾“å‡º
- å¯¹æ¯”cronï¼Œç†è§£å„è‡ªä¼˜åŠ¿

**æ ¸å¿ƒè®°å¿†**ï¼š
> ğŸ§  **å£è¯€**ï¼štimerå®šæ—¶serviceå¹²æ´»ï¼Œenableå¯ç”¨startè¿è¡Œï¼ŒlistæŸ¥çœ‹statusè¯¦æƒ…ï¼Œjournalçœ‹æ—¥å¿—analyzeæµ‹æ—¶é—´

systemdå®šæ—¶å™¨æ˜¯ç°ä»£Linuxç³»ç»Ÿç®¡ç†çš„é‡è¦å·¥å…·ï¼ŒæŒæ¡å®ƒå¯ä»¥è®©ç³»ç»Ÿç»´æŠ¤å·¥ä½œæ›´åŠ è‡ªåŠ¨åŒ–å’Œå¯é ï¼