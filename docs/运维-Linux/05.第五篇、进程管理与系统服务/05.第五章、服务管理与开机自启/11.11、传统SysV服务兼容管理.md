---
title: 11ã€ä¼ ç»ŸSysVæœåŠ¡å…¼å®¹ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [SysV Initç³»ç»Ÿæ¦‚è¿°](#1-SysV-Initç³»ç»Ÿæ¦‚è¿°)
2. [è¿è¡Œçº§åˆ«ä¸ç³»ç»Ÿå¯åŠ¨](#2-è¿è¡Œçº§åˆ«ä¸ç³»ç»Ÿå¯åŠ¨)
3. [serviceå‘½ä»¤ç®¡ç†æœåŠ¡](#3-serviceå‘½ä»¤ç®¡ç†æœåŠ¡)
4. [chkconfigå·¥å…·è¯¦è§£](#4-chkconfigå·¥å…·è¯¦è§£)
5. [ç¼–å†™SysV initè„šæœ¬](#5-ç¼–å†™SysV-initè„šæœ¬)
6. [systemdå…¼å®¹æ€§ç®¡ç†](#6-systemdå…¼å®¹æ€§ç®¡ç†)
7. [ä¼ ç»ŸæœåŠ¡è¿ç§»å®è·µ](#7-ä¼ ç»ŸæœåŠ¡è¿ç§»å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ SysV Initç³»ç»Ÿæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯SysV Initç³»ç»Ÿ


**ğŸ“ åŸºæœ¬å®šä¹‰**
```
SysV Initï¼šSystem Våˆå§‹åŒ–ç³»ç»Ÿ
æœ¬è´¨ï¼šLinuxç³»ç»Ÿå¯åŠ¨æ—¶ç¬¬ä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹ç®¡ç†æ–¹å¼
ä½œç”¨ï¼šç®¡ç†ç³»ç»Ÿå¯åŠ¨ã€æœåŠ¡è¿è¡Œã€ç³»ç»Ÿå…³é—­çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ
å†å²ï¼šUnix System Vçš„ç»å…¸å¯åŠ¨æ–¹å¼ï¼Œåœ¨Linuxä¸­å¹¿æ³›ä½¿ç”¨
```

**ğŸ¯ ç†è§£è¦ç‚¹**ï¼š
- **è¿›ç¨‹ä¹‹ç‹**ï¼šinitè¿›ç¨‹ï¼ˆPID=1ï¼‰ï¼Œæ‰€æœ‰è¿›ç¨‹çš„ç¥–å…ˆ
- **ä¸²è¡Œå¯åŠ¨**ï¼šæœåŠ¡æŒ‰ç…§é¢„å®šé¡ºåºä¸€ä¸ªæ¥ä¸€ä¸ªå¯åŠ¨
- **è„šæœ¬é©±åŠ¨**ï¼šé€šè¿‡shellè„šæœ¬æ§åˆ¶æœåŠ¡çš„å¯åœ

### 1.2 SysV Init vs ç°ä»£systemd


**ğŸ†š æ ¸å¿ƒå·®å¼‚å¯¹æ¯”**ï¼š

| **å¯¹æ¯”ç»´åº¦** | **SysV Init** | **systemd** |
|-------------|---------------|-------------|
| ğŸš€ **å¯åŠ¨æ–¹å¼** | ä¸²è¡Œå¯åŠ¨ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œ | å¹¶è¡Œå¯åŠ¨ï¼Œä¾èµ–å…³ç³»è‡ªåŠ¨å¤„ç† |
| â° **å¯åŠ¨é€Ÿåº¦** | è¾ƒæ…¢ï¼Œéœ€è¦ç­‰å¾…å‰åºæœåŠ¡ | æ›´å¿«ï¼ŒåŒæ—¶å¯åŠ¨å¤šä¸ªæœåŠ¡ |
| ğŸ“ **é…ç½®æ–‡ä»¶** | shellè„šæœ¬ï¼ˆ/etc/init.d/ï¼‰ | é…ç½®æ–‡ä»¶ï¼ˆ.serviceå•å…ƒï¼‰ |
| ğŸ”§ **ç®¡ç†å·¥å…·** | serviceã€chkconfig | systemctl |
| ğŸ“Š **å¤æ‚åº¦** | ç®€å•æ˜“æ‡‚ï¼Œè„šæœ¬é€»è¾‘æ¸…æ™° | åŠŸèƒ½å¼ºå¤§ï¼Œå­¦ä¹ æ›²çº¿é™¡å³­ |

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦å­¦ä¹ SysV**ï¼š
```
å…¼å®¹æ€§éœ€æ±‚ï¼šå¾ˆå¤šè€ç³»ç»Ÿä»åœ¨ä½¿ç”¨
ç†è§£åŸºç¡€ï¼šå¸®åŠ©ç†è§£Linuxå¯åŠ¨åŸç†
è¿ç§»éœ€è¦ï¼šä»ä¼ ç»Ÿç³»ç»Ÿå‡çº§åˆ°ç°ä»£ç³»ç»Ÿ
æ•…éšœæ’æŸ¥ï¼šå¤„ç†é—ç•™ç³»ç»Ÿé—®é¢˜
```

### 1.3 SysV Initç›®å½•ç»“æ„


**ğŸ—‚ï¸ æ ¸å¿ƒç›®å½•ç»“æ„**ï¼š
```
/etc/init.d/           # å­˜æ”¾æ‰€æœ‰æœåŠ¡å¯åŠ¨è„šæœ¬
â”œâ”€â”€ apache2           # Apache webæœåŠ¡å™¨è„šæœ¬
â”œâ”€â”€ mysql             # MySQLæ•°æ®åº“æœåŠ¡è„šæœ¬
â”œâ”€â”€ ssh               # SSHæœåŠ¡è„šæœ¬
â””â”€â”€ networking        # ç½‘ç»œæœåŠ¡è„šæœ¬

/etc/rc.d/            # è¿è¡Œçº§åˆ«ç›®å½•ï¼ˆéƒ¨åˆ†å‘è¡Œç‰ˆï¼‰
â”œâ”€â”€ rc0.d/            # å…³æœºæ—¶è¿è¡Œçš„è„šæœ¬
â”œâ”€â”€ rc1.d/            # å•ç”¨æˆ·æ¨¡å¼
â”œâ”€â”€ rc2.d/            # å¤šç”¨æˆ·æ¨¡å¼ï¼ˆæ— ç½‘ç»œï¼‰
â”œâ”€â”€ rc3.d/            # å¤šç”¨æˆ·æ¨¡å¼ï¼ˆæœ‰ç½‘ç»œï¼‰
â”œâ”€â”€ rc5.d/            # å›¾å½¢ç•Œé¢æ¨¡å¼
â””â”€â”€ rc6.d/            # é‡å¯æ—¶è¿è¡Œçš„è„šæœ¬
```

---

## 2. ğŸ“Š è¿è¡Œçº§åˆ«ä¸ç³»ç»Ÿå¯åŠ¨


### 2.1 è¿è¡Œçº§åˆ«åŸºæœ¬æ¦‚å¿µ


**ğŸ¯ ä»€ä¹ˆæ˜¯è¿è¡Œçº§åˆ«**ï¼š
```
è¿è¡Œçº§åˆ«ï¼šç³»ç»Ÿçš„å·¥ä½œæ¨¡å¼ï¼Œå†³å®šå¯åŠ¨å“ªäº›æœåŠ¡
èŒƒå›´ï¼šé€šå¸¸0-6å…±7ä¸ªçº§åˆ«
ä½œç”¨ï¼šä¸åŒåœºæ™¯ä¸‹å¯åŠ¨ä¸åŒçš„æœåŠ¡ç»„åˆ
åˆ‡æ¢ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åˆ‡æ¢è¿è¡Œçº§åˆ«
```

**ğŸ“‹ æ ‡å‡†è¿è¡Œçº§åˆ«è¯¦è§£**ï¼š

| **çº§åˆ«** | **åç§°** | **è¯´æ˜** | **å…¸å‹ç”¨é€”** |
|---------|----------|----------|-------------|
| **0** | **å…³æœº** | ç³»ç»Ÿå…³é—­çŠ¶æ€ | ğŸ”´ å…³é—­ç³»ç»Ÿ |
| **1** | **å•ç”¨æˆ·æ¨¡å¼** | åªæœ‰rootç”¨æˆ·ï¼Œæ— ç½‘ç»œ | ğŸ› ï¸ ç³»ç»Ÿç»´æŠ¤ã€å¯†ç é‡ç½® |
| **2** | **å¤šç”¨æˆ·æ¨¡å¼** | å¤šç”¨æˆ·ï¼Œæ— ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ | ğŸ”§ æœ¬åœ°ç»´æŠ¤æ¨¡å¼ |
| **3** | **å¤šç”¨æˆ·æ¨¡å¼** | å®Œæ•´å¤šç”¨æˆ·ï¼Œå‘½ä»¤è¡Œç•Œé¢ | ğŸ’» æœåŠ¡å™¨æ ‡å‡†æ¨¡å¼ |
| **4** | **æœªå®šä¹‰** | ç”¨æˆ·è‡ªå®šä¹‰ | ğŸ¯ ç‰¹æ®Šç”¨é€” |
| **5** | **å›¾å½¢ç•Œé¢** | å®Œæ•´å¤šç”¨æˆ·ï¼Œå›¾å½¢ç•Œé¢ | ğŸ–¥ï¸ æ¡Œé¢ç¯å¢ƒ |
| **6** | **é‡å¯** | ç³»ç»Ÿé‡å¯ | ğŸ”„ é‡å¯ç³»ç»Ÿ |

### 2.2 è¿è¡Œçº§åˆ«ç®¡ç†å‘½ä»¤


**ğŸ”§ æŸ¥çœ‹å’Œåˆ‡æ¢è¿è¡Œçº§åˆ«**ï¼š
```bash
# æŸ¥çœ‹å½“å‰è¿è¡Œçº§åˆ«
runlevel
# è¾“å‡ºç¤ºä¾‹ï¼šN 3 (ä»æ— çº§åˆ«å¯åŠ¨åˆ°çº§åˆ«3)

# æŸ¥çœ‹é»˜è®¤è¿è¡Œçº§åˆ«
cat /etc/inittab | grep initdefault
# è¾“å‡ºï¼šid:3:initdefault:

# ä¸´æ—¶åˆ‡æ¢åˆ°å…¶ä»–è¿è¡Œçº§åˆ«
init 5          # åˆ‡æ¢åˆ°å›¾å½¢ç•Œé¢æ¨¡å¼
telinit 1       # åˆ‡æ¢åˆ°å•ç”¨æˆ·æ¨¡å¼

# ä¿®æ”¹é»˜è®¤è¿è¡Œçº§åˆ«
echo "id:5:initdefault:" > /etc/inittab
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**ï¼š
- **æœåŠ¡å™¨ç¯å¢ƒ**ï¼šé€šå¸¸ä½¿ç”¨çº§åˆ«3ï¼ˆå‘½ä»¤è¡Œï¼ŒèŠ‚çœèµ„æºï¼‰
- **æ¡Œé¢ç¯å¢ƒ**ï¼šä½¿ç”¨çº§åˆ«5ï¼ˆå›¾å½¢ç•Œé¢ï¼Œç”¨æˆ·å‹å¥½ï¼‰
- **ç³»ç»Ÿç»´æŠ¤**ï¼šä½¿ç”¨çº§åˆ«1ï¼ˆå•ç”¨æˆ·ï¼Œå®‰å…¨ç»´æŠ¤ï¼‰

### 2.3 rc.dç›®å½•ä¸å¯åŠ¨é¡ºåº


**ğŸ¯ rc.dç›®å½•çš„ä½œç”¨**ï¼š
```
æ¯ä¸ªè¿è¡Œçº§åˆ«å¯¹åº”ä¸€ä¸ªrc.dç›®å½•
ç›®å½•ä¸­åŒ…å«è¯¥çº§åˆ«è¦å¯åŠ¨/åœæ­¢çš„æœåŠ¡é“¾æ¥
é“¾æ¥æŒ‡å‘/etc/init.d/ä¸­çš„å®é™…è„šæœ¬
é€šè¿‡Så’ŒKå‰ç¼€åŒºåˆ†å¯åŠ¨å’Œåœæ­¢æ“ä½œ
```

**ğŸ“‚ rc.dç›®å½•ç»“æ„ç¤ºä¾‹**ï¼š
```bash
ls -la /etc/rc3.d/
# è¾“å‡ºç¤ºä¾‹ï¼š
S10networking    -> ../init.d/networking   # S=å¯åŠ¨ï¼Œ10=ä¼˜å…ˆçº§
S20ssh          -> ../init.d/ssh          # æ•°å­—è¶Šå°è¶Šå…ˆæ‰§è¡Œ
S80apache2      -> ../init.d/apache2      # ä¾èµ–å…³ç³»é€šè¿‡æ•°å­—æ§åˆ¶
K20apache2      -> ../init.d/apache2      # K=åœæ­¢æœåŠ¡
```

**ğŸ”„ å¯åŠ¨æµç¨‹å›¾**ï¼š
```
ç³»ç»Ÿå¯åŠ¨
    â†“
è¯»å–/etc/inittabç¡®å®šé»˜è®¤è¿è¡Œçº§åˆ«
    â†“
æ‰§è¡Œå¯¹åº”rc.dç›®å½•ä¸­çš„è„šæœ¬
    â†“
æŒ‰ç…§S##å¼€å¤´çš„è„šæœ¬é¡ºåºå¯åŠ¨æœåŠ¡
    â†“
ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼Œç”¨æˆ·å¯ä»¥ç™»å½•
```

---

## 3. âš™ï¸ serviceå‘½ä»¤ç®¡ç†æœåŠ¡


### 3.1 serviceå‘½ä»¤åŸºæœ¬ç”¨æ³•


**ğŸ“ serviceå‘½ä»¤æ˜¯ä»€ä¹ˆ**ï¼š
```
serviceï¼šSysVæœåŠ¡ç®¡ç†å·¥å…·
æœ¬è´¨ï¼šå¯¹/etc/init.d/è„šæœ¬çš„å‹å¥½åŒ…è£…
ä½œç”¨ï¼šç»Ÿä¸€çš„æœåŠ¡å¯åœã€çŠ¶æ€æŸ¥è¯¢æ¥å£
è¯­æ³•ï¼šservice æœåŠ¡å æ“ä½œ
```

**ğŸ”§ åŸºæœ¬æ“ä½œå‘½ä»¤**ï¼š
```bash
# å¯åŠ¨æœåŠ¡
service apache2 start
service mysql start

# åœæ­¢æœåŠ¡
service apache2 stop
service nginx stop

# é‡å¯æœåŠ¡ï¼ˆstop + startï¼‰
service ssh restart

# é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸é‡å¯è¿›ç¨‹ï¼‰
service apache2 reload

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
service mysql status

# åˆ—å‡ºæ‰€æœ‰æœåŠ¡çŠ¶æ€
service --status-all
```

### 3.2 serviceå‘½ä»¤çš„å®é™…è¿è¡Œæœºåˆ¶


**ğŸ’¡ serviceå‘½ä»¤èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆ**ï¼š
```bash
# å½“ä½ æ‰§è¡Œï¼š
service apache2 start

# å®é™…ä¸Šç³»ç»Ÿæ‰§è¡Œï¼š
/etc/init.d/apache2 start

# è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸‹é¢ä¸¤ä¸ªå‘½ä»¤ç­‰æ•ˆï¼š
service apache2 restart
/etc/init.d/apache2 restart
```

**ğŸ¯ serviceå‘½ä»¤çš„ä¼˜åŠ¿**ï¼š
- **è·¯å¾„æ— å…³**ï¼šä¸éœ€è¦è®°ä½è„šæœ¬å®Œæ•´è·¯å¾„
- **è¯­æ³•ç»Ÿä¸€**ï¼šæ‰€æœ‰æœåŠ¡ä½¿ç”¨ç›¸åŒçš„å‘½ä»¤æ ¼å¼
- **é”™è¯¯å¤„ç†**ï¼šæä¾›æ›´å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- **å…¼å®¹æ€§å¥½**ï¼šåœ¨ä¸åŒå‘è¡Œç‰ˆä¸­è¡Œä¸ºä¸€è‡´

### 3.3 serviceå‘½ä»¤å®ç”¨æŠ€å·§


**ğŸ“Š æ‰¹é‡ç®¡ç†æœåŠ¡**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€ï¼ˆå½©è‰²è¾“å‡ºï¼‰
service --status-all

# è¾“å‡ºè¯´æ˜ï¼š
# [ + ] è¡¨ç¤ºæ­£åœ¨è¿è¡Œ
# [ - ] è¡¨ç¤ºå·²åœæ­¢
# [ ? ] è¡¨ç¤ºçŠ¶æ€æœªçŸ¥

# å¯åŠ¨å¤šä¸ªç›¸å…³æœåŠ¡
service mysql start && service apache2 start && service php7.4-fpm start

# æ£€æŸ¥æœåŠ¡æ˜¯å¦æˆåŠŸå¯åŠ¨
if service apache2 status > /dev/null 2>&1; then
    echo "Apache2 is running"
else
    echo "Apache2 is not running"
fi
```

**ğŸ” æ•…éšœæ’æŸ¥æŠ€å·§**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†å¯åŠ¨ä¿¡æ¯
service apache2 start
echo $?  # æ£€æŸ¥è¿”å›ç ï¼Œ0è¡¨ç¤ºæˆåŠŸ

# æŸ¥çœ‹æœåŠ¡é…ç½®æ˜¯å¦æ­£ç¡®
service apache2 configtest  # Apacheç‰¹æœ‰å‘½ä»¤

# æŸ¥çœ‹æœåŠ¡è¿›ç¨‹
ps aux | grep apache2
netstat -tulpn | grep :80  # æ£€æŸ¥ç«¯å£ç›‘å¬
```

---

## 4. ğŸ› ï¸ chkconfigå·¥å…·è¯¦è§£


### 4.1 chkconfigåŸºæœ¬æ¦‚å¿µ


**ğŸ“ chkconfigæ˜¯ä»€ä¹ˆ**ï¼š
```
chkconfigï¼šè¿è¡Œçº§åˆ«æœåŠ¡ç®¡ç†å·¥å…·
ä½œç”¨ï¼šè®¾ç½®æœåŠ¡åœ¨ä¸åŒè¿è¡Œçº§åˆ«çš„å¯åŠ¨çŠ¶æ€
ç®¡ç†ï¼šæ§åˆ¶rc.dç›®å½•ä¸­çš„ç¬¦å·é“¾æ¥
èŒƒå›´ï¼šRed Hatç³»å‘è¡Œç‰ˆçš„æ ‡å‡†å·¥å…·
```

**ğŸ¯ chkconfigè§£å†³çš„é—®é¢˜**ï¼š
- **è‡ªå¯åŠ¨ç®¡ç†**ï¼šè®¾ç½®æœåŠ¡å¼€æœºæ˜¯å¦è‡ªåŠ¨å¯åŠ¨
- **çº§åˆ«æ§åˆ¶**ï¼šç²¾ç¡®æ§åˆ¶åœ¨å“ªäº›è¿è¡Œçº§åˆ«å¯åŠ¨
- **æ‰¹é‡æ“ä½œ**ï¼šä¸€æ¬¡æ€§ç®¡ç†å¤šä¸ªè¿è¡Œçº§åˆ«
- **çŠ¶æ€æŸ¥è¯¢**ï¼šæŸ¥çœ‹æœåŠ¡çš„å¯åŠ¨é…ç½®çŠ¶æ€

### 4.2 chkconfigå¸¸ç”¨å‘½ä»¤


**ğŸ”§ åŸºæœ¬æ“ä½œè¯­æ³•**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„å¯åŠ¨çŠ¶æ€
chkconfig --list

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çŠ¶æ€
chkconfig --list apache2
# è¾“å‡ºï¼šapache2  0:off 1:off 2:on 3:on 4:on 5:on 6:off

# åœ¨æ‰€æœ‰é€‚å½“çº§åˆ«å¯ç”¨æœåŠ¡
chkconfig apache2 on

# åœ¨æ‰€æœ‰çº§åˆ«ç¦ç”¨æœåŠ¡
chkconfig apache2 off

# åœ¨ç‰¹å®šçº§åˆ«å¯ç”¨/ç¦ç”¨
chkconfig --level 35 apache2 on   # ä»…åœ¨çº§åˆ«3,5å¯ç”¨
chkconfig --level 2 apache2 off   # åœ¨çº§åˆ«2ç¦ç”¨
```

**ğŸ“Š è¾“å‡ºç»“æœè§£è¯»**ï¼š
```
apache2    0:off  1:off  2:on  3:on  4:on  5:on  6:off
           â†‘      â†‘      â†‘     â†‘     â†‘     â†‘     â†‘
          å…³æœº   å•ç”¨æˆ·  å¤šç”¨æˆ· å¤šç”¨æˆ· è‡ªå®šä¹‰ å›¾å½¢ç•Œé¢ é‡å¯
```

### 4.3 chkconfigé«˜çº§ç”¨æ³•


**âš™ï¸ æ·»åŠ è‡ªå®šä¹‰æœåŠ¡**ï¼š
```bash
# æ·»åŠ æœåŠ¡åˆ°chkconfigç®¡ç†
chkconfig --add myservice

# åˆ é™¤æœåŠ¡ï¼ˆä»ç®¡ç†ä¸­ç§»é™¤ï¼‰
chkconfig --del myservice

# é‡ç½®æœåŠ¡åˆ°é»˜è®¤çŠ¶æ€
chkconfig --add myservice  # ä¼šè¯»å–è„šæœ¬ä¸­çš„é»˜è®¤é…ç½®
```

**ğŸ¯ æ‰¹é‡ç®¡ç†ç¤ºä¾‹**ï¼š
```bash
# ç¦ç”¨æ‰€æœ‰ä¸å¿…è¦çš„æœåŠ¡ï¼ˆæœåŠ¡å™¨ä¼˜åŒ–ï¼‰
for service in bluetooth cups avahi-daemon; do
    chkconfig $service off
done

# ç¡®ä¿å…³é”®æœåŠ¡å¼€æœºå¯åŠ¨
for service in sshd network iptables; do
    chkconfig $service on
done
```

**ğŸ” ä¸systemdç¯å¢ƒçš„å…¼å®¹æ€§**ï¼š
```bash
# åœ¨systemdç³»ç»Ÿä¸­ï¼Œchkconfigé€šå¸¸è¢«é‡å®šå‘åˆ°systemctl
# ä½†ä¸ºäº†å…¼å®¹æ€§ï¼Œå¾ˆå¤šç³»ç»Ÿä»ç„¶æ”¯æŒchkconfigå‘½ä»¤

# æ£€æŸ¥æ˜¯å¦æ”¯æŒchkconfig
which chkconfig
# æˆ–è€…
chkconfig --version
```

---

## 5. ğŸ“ ç¼–å†™SysV initè„šæœ¬


### 5.1 initè„šæœ¬åŸºæœ¬ç»“æ„


**ğŸ—ï¸ æ ‡å‡†è„šæœ¬ç»“æ„**ï¼š
```bash
#!/bin/bash
#
# myservice        My Custom Service
#
# chkconfig: 35 80 20
# description: This is my custom service that does something useful
#

. /etc/rc.d/init.d/functions  # åŠ è½½ç³»ç»Ÿå‡½æ•°åº“

USER="myuser"
DAEMON="myservice"
ROOT_DIR="/var/lib/myservice"
PID_FILE="/var/run/myservice.pid"
LOCK_FILE="/var/lock/subsys/myservice"

start() {
    echo -n $"Starting $DAEMON: "
    daemon --user "$USER" --pidfile="$PID_FILE" \
           "$ROOT_DIR/$DAEMON" --daemon
    RETVAL=$?
    echo
    [ $RETVAL -eq 0 ] && touch $LOCK_FILE
    return $RETVAL
}

stop() {
    echo -n $"Shutting down $DAEMON: "
    pid=`ps -aefw | grep "$DAEMON" | grep -v " grep " | awk '{print $2}'`
    kill -9 $pid > /dev/null 2>&1
    [ $? -eq 0 ] && success $"$DAEMON shutdown" || failure $"$DAEMON shutdown"
    rm -f $LOCK_FILE
    rm -f $PID_FILE
    echo
}

restart() {
    stop
    start
}

status() {
    if [ -f $PID_FILE ]; then
        echo "$DAEMON is running."
    else
        echo "$DAEMON is stopped."
    fi
}

case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    status)
        status
        ;;
    restart)
        restart
        ;;
    *)
        echo "Usage: {start|stop|status|restart}"
        exit 1
        ;;
esac

exit $?
```

### 5.2 è„šæœ¬å…³é”®è¦ç´ è§£æ


**ğŸ“‹ chkconfigæŒ‡ä»¤å«ä¹‰**ï¼š
```bash
# chkconfig: 35 80 20
#            â†‘  â†‘  â†‘
#            |  |  â””â”€â”€ åœæ­¢ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°è¶Šå…ˆåœæ­¢ï¼‰
#            |  â””â”€â”€â”€â”€â”€ å¯åŠ¨ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°è¶Šå…ˆå¯åŠ¨ï¼‰  
#            â””â”€â”€â”€â”€â”€â”€â”€â”€ é»˜è®¤å¯åŠ¨çš„è¿è¡Œçº§åˆ«
```

**ğŸ”§ ç³»ç»Ÿå‡½æ•°åº“çš„ä½œç”¨**ï¼š
```bash
# /etc/rc.d/init.d/functions æä¾›çš„å¸¸ç”¨å‡½æ•°ï¼š
daemon    # å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹
killproc  # åœæ­¢è¿›ç¨‹
pidofproc # æŸ¥æ‰¾è¿›ç¨‹PID
success   # æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
failure   # æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯
```

### 5.3 ç¼–å†™è„šæœ¬çš„æœ€ä½³å®è·µ


**âœ… è„šæœ¬ç¼–å†™æ£€æŸ¥æ¸…å•**ï¼š

| **æ£€æŸ¥é¡¹** | **è¯´æ˜** | **ç¤ºä¾‹** |
|-----------|----------|----------|
| ğŸ”§ **æƒé™è®¾ç½®** | è„šæœ¬å¿…é¡»å¯æ‰§è¡Œ | `chmod +x /etc/init.d/myservice` |
| ğŸ“ **PIDæ–‡ä»¶ç®¡ç†** | æ­£ç¡®åˆ›å»ºå’Œæ¸…ç†PIDæ–‡ä»¶ | `/var/run/service.pid` |
| ğŸ”’ **é”æ–‡ä»¶ç®¡ç†** | é˜²æ­¢é‡å¤å¯åŠ¨ | `/var/lock/subsys/service` |
| ğŸ‘¤ **ç”¨æˆ·æƒé™** | ä½¿ç”¨é€‚å½“çš„ç”¨æˆ·è¿è¡ŒæœåŠ¡ | `--user "$USER"` |
| ğŸ” **çŠ¶æ€æ£€æŸ¥** | å‡†ç¡®æŠ¥å‘ŠæœåŠ¡çŠ¶æ€ | æ£€æŸ¥PIDå’Œè¿›ç¨‹çŠ¶æ€ |

**ğŸ’¡ å®ç”¨è„šæœ¬æ¨¡æ¿**ï¼š
```bash
# ç®€åŒ–ç‰ˆè„šæœ¬æ¨¡æ¿ï¼ˆé€‚åˆå­¦ä¹ ï¼‰
#!/bin/bash
# Simple service script template

SERVICE_NAME="myapp"
SERVICE_PATH="/usr/local/bin/myapp"
PID_FILE="/var/run/$SERVICE_NAME.pid"

start_service() {
    if [ -f $PID_FILE ]; then
        echo "$SERVICE_NAME is already running"
        return 1
    fi
    
    echo "Starting $SERVICE_NAME..."
    $SERVICE_PATH &
    echo $! > $PID_FILE
    echo "$SERVICE_NAME started"
}

stop_service() {
    if [ ! -f $PID_FILE ]; then
        echo "$SERVICE_NAME is not running"
        return 1
    fi
    
    echo "Stopping $SERVICE_NAME..."
    PID=$(cat $PID_FILE)
    kill $PID
    rm -f $PID_FILE
    echo "$SERVICE_NAME stopped"
}

case "$1" in
    start) start_service ;;
    stop)  stop_service ;;
    restart) stop_service && start_service ;;
    *) echo "Usage: $0 {start|stop|restart}" ;;
esac
```

---

## 6. ğŸ”„ systemdå…¼å®¹æ€§ç®¡ç†


### 6.1 systemdå¯¹SysVçš„å…¼å®¹æ”¯æŒ


**ğŸ¯ systemdå…¼å®¹æ€§åŸç†**ï¼š
```
systemdåŸç”Ÿæ”¯æŒï¼šç°ä»£.serviceå•å…ƒæ–‡ä»¶
SysVå…¼å®¹å±‚ï¼šè‡ªåŠ¨åŒ…è£…/etc/init.d/è„šæœ¬
åŠ¨æ€ç”Ÿæˆï¼šä¸ºSysVè„šæœ¬åˆ›å»ºä¸´æ—¶.serviceå•å…ƒ
å‘½ä»¤æ˜ å°„ï¼šserviceå‘½ä»¤é‡å®šå‘åˆ°systemctl
```

**ğŸ“Š å…¼å®¹æ€§å¯¹æ¯”**ï¼š

| **æ“ä½œ** | **SysVå‘½ä»¤** | **systemdç­‰æ•ˆå‘½ä»¤** | **å…¼å®¹æ€§** |
|---------|-------------|-------------------|-----------|
| ğŸš€ **å¯åŠ¨æœåŠ¡** | `service ssh start` | `systemctl start ssh` | âœ… å®Œå…¨å…¼å®¹ |
| ğŸ›‘ **åœæ­¢æœåŠ¡** | `service ssh stop` | `systemctl stop ssh` | âœ… å®Œå…¨å…¼å®¹ |
| ğŸ”„ **é‡å¯æœåŠ¡** | `service ssh restart` | `systemctl restart ssh` | âœ… å®Œå…¨å…¼å®¹ |
| ğŸ“Š **æŸ¥çœ‹çŠ¶æ€** | `service ssh status` | `systemctl status ssh` | âš ï¸ è¾“å‡ºæ ¼å¼ä¸åŒ |
| âš™ï¸ **å¼€æœºå¯åŠ¨** | `chkconfig ssh on` | `systemctl enable ssh` | âœ… åŠŸèƒ½å…¼å®¹ |

### 6.2 åœ¨systemdç³»ç»Ÿä¸­ç®¡ç†SysVæœåŠ¡


**ğŸ”§ æ··åˆç¯å¢ƒç®¡ç†**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬SysVå’Œsystemdï¼‰
systemctl list-units --type=service --all

# æŸ¥çœ‹SysVæœåŠ¡çŠ¶æ€
systemctl status ssh.service
# è¾“å‡ºä¼šæ˜¾ç¤ºè¿™æ˜¯ä¸€ä¸ªSysVæœåŠ¡

# SysVæœåŠ¡çš„systemdç®¡ç†
systemctl start ssh      # å¯åŠ¨SysVæœåŠ¡
systemctl enable ssh     # è®¾ç½®å¼€æœºå¯åŠ¨
systemctl is-enabled ssh # æ£€æŸ¥å¯åŠ¨çŠ¶æ€
```

**ğŸ’¡ è¯†åˆ«æœåŠ¡ç±»å‹**ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡æ˜¯åŸç”Ÿsystemdè¿˜æ˜¯SysVå…¼å®¹
systemctl cat ssh.service

# åŸç”ŸsystemdæœåŠ¡æ˜¾ç¤ºï¼š
# [Unit]
# Description=OpenSSH server daemon
# ...

# SysVå…¼å®¹æœåŠ¡æ˜¾ç¤ºï¼š
# # /etc/init.d/ssh
# # Automatically generated by systemd-sysv-generator
```

### 6.3 systemdç¯å¢ƒä¸‹çš„æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š
- **æ–°æœåŠ¡**ï¼šç›´æ¥ç¼–å†™.serviceå•å…ƒæ–‡ä»¶
- **è€æœåŠ¡**ï¼šä¿æŒSysVè„šæœ¬ï¼Œåˆ©ç”¨å…¼å®¹å±‚
- **è¿ç§»ç­–ç•¥**ï¼šé€æ­¥å°†å…³é”®æœåŠ¡è¿ç§»åˆ°systemd
- **ç›‘æ§æ–¹å¼**ï¼šä½¿ç”¨systemctlå‘½ä»¤è¿›è¡Œç»Ÿä¸€ç®¡ç†

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
```bash
# SysVæœåŠ¡åœ¨systemdä¸‹çš„é™åˆ¶
# 1. æ— æ³•ä½¿ç”¨systemdçš„é«˜çº§ç‰¹æ€§ï¼ˆä¾èµ–ç®¡ç†ã€è‡ªåŠ¨é‡å¯ç­‰ï¼‰
# 2. å¯åŠ¨æ—¥å¿—å¯èƒ½ä¸å¤Ÿè¯¦ç»†
# 3. æ€§èƒ½ç›‘æ§åŠŸèƒ½å—é™

# æ£€æŸ¥SysVæœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œ
systemctl status myservice.service
journalctl -u myservice.service  # æŸ¥çœ‹æœåŠ¡æ—¥å¿—
```

---

## 7. ğŸ”„ ä¼ ç»ŸæœåŠ¡è¿ç§»å®è·µ


### 7.1 è¿ç§»ç­–ç•¥ä¸è§„åˆ’


**ğŸ¯ è¿ç§»è¯„ä¼°æ¸…å•**ï¼š

| **è¯„ä¼°ç»´åº¦** | **æ£€æŸ¥å†…å®¹** | **å½±å“ç¨‹åº¦** |
|-------------|-------------|-------------|
| ğŸ”§ **æœåŠ¡å¤æ‚åº¦** | è„šæœ¬è¡Œæ•°ã€ä¾èµ–å…³ç³» | ğŸŸ¡ ä¸­ç­‰ |
| âš¡ **ä¸šåŠ¡é‡è¦æ€§** | æ˜¯å¦ä¸ºå…³é”®ä¸šåŠ¡æœåŠ¡ | ğŸ”´ é«˜ |
| ğŸ• **ç»´æŠ¤é¢‘ç‡** | å¤šä¹…ä¿®æ”¹ä¸€æ¬¡é…ç½® | ğŸŸ¢ ä½ |
| ğŸ‘¥ **å›¢é˜ŸæŠ€èƒ½** | å›¢é˜Ÿå¯¹systemdçš„ç†Ÿæ‚‰ç¨‹åº¦ | ğŸŸ¡ ä¸­ç­‰ |
| â±ï¸ **åœæœºçª—å£** | å¯æ¥å—çš„æœåŠ¡ä¸­æ–­æ—¶é—´ | ğŸ”´ é«˜ |

**ğŸ“‹ è¿ç§»æ­¥éª¤**ï¼š
```
Phase 1: ç°çŠ¶åˆ†æ
â””â”€â”€ åˆ—å‡ºæ‰€æœ‰SysVæœåŠ¡
â””â”€â”€ è¯„ä¼°ä¸šåŠ¡å½±å“
â””â”€â”€ åˆ¶å®šè¿ç§»ä¼˜å…ˆçº§

Phase 2: æµ‹è¯•ç¯å¢ƒè¿ç§»
â””â”€â”€ åˆ›å»ºsystemdå•å…ƒæ–‡ä»¶
â””â”€â”€ åŠŸèƒ½æµ‹è¯•
â””â”€â”€ æ€§èƒ½æµ‹è¯•

Phase 3: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
â””â”€â”€ å¤‡ä»½åŸè„šæœ¬
â””â”€â”€ éƒ¨ç½²æ–°é…ç½®
â””â”€â”€ éªŒè¯åŠŸèƒ½æ­£å¸¸
```

### 7.2 SysVåˆ°systemdè¿ç§»ç¤ºä¾‹


**ğŸ“ åŸSysVè„šæœ¬è½¬æ¢**ï¼š
```bash
# åŸSysVè„šæœ¬ï¼š/etc/init.d/myapp
#!/bin/bash
# myapp service

start() {
    echo "Starting myapp..."
    /usr/local/bin/myapp --daemon --config=/etc/myapp.conf
}

stop() {
    echo "Stopping myapp..."
    killall myapp
}

# è½¬æ¢ä¸ºsystemdå•å…ƒï¼š/etc/systemd/system/myapp.service
[Unit]
Description=My Application Service
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/bin/myapp --daemon --config=/etc/myapp.conf
ExecStop=/bin/killall myapp
PIDFile=/var/run/myapp.pid
User=myapp
Group=myapp

[Install]
WantedBy=multi-user.target
```

**ğŸ”„ è¿ç§»æ‰§è¡Œæ­¥éª¤**ï¼š
```bash
# 1. åœæ­¢åŸSysVæœåŠ¡
service myapp stop
chkconfig myapp off

# 2. å®‰è£…systemdå•å…ƒæ–‡ä»¶
cp myapp.service /etc/systemd/system/
systemctl daemon-reload

# 3. å¯åŠ¨å¹¶å¯ç”¨æ–°æœåŠ¡
systemctl start myapp
systemctl enable myapp

# 4. éªŒè¯æœåŠ¡çŠ¶æ€
systemctl status myapp
systemctl is-enabled myapp
```

### 7.3 å…¼å®¹æ€§é—®é¢˜å¤„ç†


**âš ï¸ å¸¸è§å…¼å®¹æ€§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**ï¼š

**é—®é¢˜1ï¼šç¯å¢ƒå˜é‡ä¸¢å¤±**
```bash
# SysVè„šæœ¬ä¸­çš„ç¯å¢ƒå˜é‡åœ¨systemdä¸­å¯èƒ½ä¸ç”Ÿæ•ˆ
# è§£å†³æ–¹æ¡ˆï¼šåœ¨.serviceæ–‡ä»¶ä¸­æ˜ç¡®æŒ‡å®š
[Service]
Environment="PATH=/usr/local/bin:/bin:/usr/bin"
Environment="JAVA_HOME=/usr/lib/jvm/java-8-openjdk"
EnvironmentFile=/etc/myapp/env.conf  # ä»æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡
```

**é—®é¢˜2ï¼šç”¨æˆ·æƒé™é—®é¢˜**
```bash
# SysVè„šæœ¬ä¸­çš„ç”¨æˆ·åˆ‡æ¢åœ¨systemdä¸­éœ€è¦æ˜ç¡®æŒ‡å®š
[Service]
User=myapp
Group=myapp
# å¦‚æœéœ€è¦rootæƒé™å¯åŠ¨åé™æƒï¼š
# ExecStartPre=/bin/chown myapp:myapp /var/run/myapp
```

**é—®é¢˜3ï¼šä¾èµ–å…³ç³»ç®¡ç†**
```bash
# systemdçš„ä¾èµ–ç®¡ç†æ›´ä¸¥æ ¼
[Unit]
# éœ€è¦ç½‘ç»œåå¯åŠ¨
After=network.target
# éœ€è¦æ•°æ®åº“æœåŠ¡
Requires=mysql.service
After=mysql.service
```

**ğŸ”§ å›æ»šæ–¹æ¡ˆ**ï¼š
```bash
# å¦‚æœè¿ç§»å‡ºç°é—®é¢˜ï¼Œå¿«é€Ÿå›æ»šåˆ°SysV
systemctl stop myapp
systemctl disable myapp
rm /etc/systemd/system/myapp.service
systemctl daemon-reload

# æ¢å¤åŸSysVæœåŠ¡
chkconfig myapp on
service myapp start
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SysV Initï¼šä¼ ç»Ÿçš„LinuxæœåŠ¡ç®¡ç†æ–¹å¼ï¼Œè„šæœ¬é©±åŠ¨
ğŸ”¸ è¿è¡Œçº§åˆ«ï¼š0-6ä¸ªçº§åˆ«ï¼Œæ§åˆ¶ä¸åŒåœºæ™¯ä¸‹çš„æœåŠ¡å¯åŠ¨
ğŸ”¸ serviceå‘½ä»¤ï¼šç»Ÿä¸€çš„æœåŠ¡ç®¡ç†æ¥å£ï¼Œç®€åŒ–æ“ä½œ
ğŸ”¸ chkconfigå·¥å…·ï¼šç®¡ç†æœåŠ¡çš„å¼€æœºè‡ªå¯åŠ¨é…ç½®
ğŸ”¸ initè„šæœ¬ï¼š/etc/init.d/ç›®å½•ä¸‹çš„æœåŠ¡æ§åˆ¶è„šæœ¬
ğŸ”¸ systemdå…¼å®¹ï¼šç°ä»£ç³»ç»Ÿå¯¹ä¼ ç»ŸSysVçš„å…¼å®¹æ”¯æŒ
```

### 8.2 å®ç”¨æ“ä½œæŠ€èƒ½


**ğŸ› ï¸ æ—¥å¸¸ç®¡ç†å‘½ä»¤**ï¼š
```bash
# æœåŠ¡åŸºæœ¬æ“ä½œ
service nginx start/stop/restart/status
chkconfig nginx on/off

# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
runlevel                    # å½“å‰è¿è¡Œçº§åˆ«
service --status-all        # æ‰€æœ‰æœåŠ¡çŠ¶æ€
chkconfig --list           # å¼€æœºå¯åŠ¨é…ç½®
```

**ğŸ“ è„šæœ¬ç¼–å†™è¦ç‚¹**ï¼š
```bash
# initè„šæœ¬å¿…å¤‡è¦ç´ 
#!/bin/bash
# chkconfig: 35 80 20
# æ ‡å‡†çš„start/stop/restart/statuså‡½æ•°
# æ­£ç¡®çš„PIDå’Œé”æ–‡ä»¶ç®¡ç†
```

### 8.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ“Š é€‚ç”¨æƒ…å†µåˆ¤æ–­**ï¼š

| **åœºæ™¯** | **æ¨èæ–¹æ¡ˆ** | **ç†ç”±** |
|---------|-------------|----------|
| ğŸ–¥ï¸ **è€ç‰ˆæœ¬ç³»ç»Ÿ** | çº¯SysVç®¡ç† | ç³»ç»ŸåŸç”Ÿæ”¯æŒ |
| ğŸ”„ **è¿‡æ¸¡æœŸç³»ç»Ÿ** | SysV+systemdå…¼å®¹ | å¹³æ»‘è¿ç§» |
| ğŸš€ **ç°ä»£ç³»ç»Ÿ** | è¿ç§»åˆ°systemd | æ€§èƒ½å’ŒåŠŸèƒ½ä¼˜åŠ¿ |
| ğŸ¢ **ä¼ä¸šç¯å¢ƒ** | æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®š | ç¨³å®šæ€§ä¼˜å…ˆ |

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**ï¼š
- **ä¿æŒç®€å•**ï¼šSysVè„šæœ¬ç¼–å†™ä»¥åŠŸèƒ½å®ç°ä¸ºä¸»ï¼Œé¿å…è¿‡åº¦å¤æ‚
- **æ ‡å‡†åŒ–**ï¼šä½¿ç”¨ç»Ÿä¸€çš„è„šæœ¬æ¨¡æ¿å’Œå‘½åè§„èŒƒ
- **å…¼å®¹æ€§**ï¼šåœ¨systemdç¯å¢ƒä¸­æµ‹è¯•SysVæœåŠ¡çš„å…¼å®¹æ€§
- **é€æ­¥è¿ç§»**ï¼šåˆ¶å®šåˆç†çš„è¿ç§»è®¡åˆ’ï¼Œåˆ†æ‰¹è¿›è¡Œ

### 8.4 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**ï¼š
```bash
# æœåŠ¡å¯åŠ¨å¤±è´¥
service myapp start
echo $?                    # æ£€æŸ¥è¿”å›ç 
cat /var/log/messages      # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

# å¼€æœºå¯åŠ¨ä¸ç”Ÿæ•ˆ
chkconfig --list myapp     # æ£€æŸ¥é…ç½®çŠ¶æ€
ls -la /etc/rc3.d/*myapp*  # æ£€æŸ¥ç¬¦å·é“¾æ¥

# systemdå…¼å®¹æ€§é—®é¢˜
systemctl status myapp.service
journalctl -u myapp.service
```

**ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- serviceå¯åœæŸ¥çŠ¶æ€ï¼Œchkconfigç®¡å¼€æœº
- SysVè„šæœ¬æ ‡å‡†åŒ–ï¼Œstart stopä¸èƒ½å°‘
- è¿è¡Œçº§åˆ«ä¸‰å’Œäº”ï¼ŒæœåŠ¡å™¨æ¡Œé¢è¦åˆ†æ¸…
- systemdå…¼å®¹å±‚ï¼Œè€æœåŠ¡æ–°ç®¡ç†

**æ ¸å¿ƒç†è§£**ï¼š
- SysVæ˜¯LinuxæœåŠ¡ç®¡ç†çš„åŸºç¡€ï¼Œç†è§£å®ƒæœ‰åŠ©äºæ·±å…¥äº†è§£ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹
- è™½ç„¶ç°ä»£ç³»ç»Ÿå¤šä½¿ç”¨systemdï¼Œä½†SysVçš„æ¦‚å¿µå’Œå·¥å…·åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ä»ç„¶é‡è¦
- æŒæ¡ä¼ ç»ŸæœåŠ¡ç®¡ç†æ–¹æ³•ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†ç³»ç»Ÿå…¼å®¹æ€§å’Œè¿ç§»é—®é¢˜
- æ— è®ºä½¿ç”¨å“ªç§ç®¡ç†æ–¹å¼ï¼ŒæœåŠ¡çš„æœ¬è´¨éƒ½æ˜¯è¿›ç¨‹ç®¡ç†å’Œä¾èµ–æ§åˆ¶