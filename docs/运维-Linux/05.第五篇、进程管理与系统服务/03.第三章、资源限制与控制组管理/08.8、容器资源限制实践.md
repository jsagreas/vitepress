---
title: 8ã€å®¹å™¨èµ„æºé™åˆ¶å®è·µ
---
## ğŸ“š ç›®å½•

1. [å®¹å™¨èµ„æºé™åˆ¶åŸºç¡€æ¦‚å¿µ](#1-å®¹å™¨èµ„æºé™åˆ¶åŸºç¡€æ¦‚å¿µ)
2. [Dockerå®¹å™¨èµ„æºé™åˆ¶](#2-Dockerå®¹å™¨èµ„æºé™åˆ¶)
3. [Kubernetesèµ„æºç®¡ç†](#3-Kubernetesèµ„æºç®¡ç†)
4. [å®¹å™¨èµ„æºç›‘æ§](#4-å®¹å™¨èµ„æºç›‘æ§)
5. [å®¹å™¨èµ„æºæ•…éšœæ’æŸ¥](#5-å®¹å™¨èµ„æºæ•…éšœæ’æŸ¥)
6. [å®¹å™¨èµ„æºä¼˜åŒ–ç­–ç•¥](#6-å®¹å™¨èµ„æºä¼˜åŒ–ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å®¹å™¨èµ„æºé™åˆ¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å®¹å™¨èµ„æºé™åˆ¶


**ç®€å•ç†è§£**ï¼šå°±åƒç»™æ¯ä¸ªæˆ¿é—´åˆ†é…å›ºå®šçš„ç”µåŠ›å’Œæ°´æºä¸€æ ·ï¼Œå®¹å™¨èµ„æºé™åˆ¶å°±æ˜¯ç»™æ¯ä¸ªå®¹å™¨åˆ†é…å›ºå®šçš„CPUã€å†…å­˜ç­‰ç³»ç»Ÿèµ„æºã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
å…¬å¯“æ¥¼ç®¡ç† â†â†’ å®¹å™¨èµ„æºç®¡ç†
æ¯æˆ·ç”¨ç”µé™é¢ â†â†’ æ¯ä¸ªå®¹å™¨CPUé™åˆ¶  
æ¯æˆ·ç”¨æ°´é™é¢ â†â†’ æ¯ä¸ªå®¹å™¨å†…å­˜é™åˆ¶
é˜²æ­¢æŸæˆ·è¿‡åº¦ç”¨ç”µå½±å“å…¶ä»–ä½æˆ· â†â†’ é˜²æ­¢æŸä¸ªå®¹å™¨å ç”¨è¿‡å¤šèµ„æºå½±å“å…¶ä»–å®¹å™¨
```

**ä¸ºä»€ä¹ˆéœ€è¦èµ„æºé™åˆ¶**ï¼š
- **é˜²æ­¢èµ„æºäº‰æŠ¢**ï¼šä¸€ä¸ªå®¹å™¨ä¸èƒ½éœ¸å æ‰€æœ‰CPUå’Œå†…å­˜
- **ä¿è¯æœåŠ¡ç¨³å®š**ï¼šæ¯ä¸ªåº”ç”¨éƒ½èƒ½è·å¾—åŸºæœ¬çš„èµ„æºä¿éšœ
- **æé«˜èµ„æºåˆ©ç”¨ç‡**ï¼šåˆç†åˆ†é…èµ„æºï¼Œé¿å…æµªè´¹
- **æ•…éšœéš”ç¦»**ï¼šæŸä¸ªå®¹å™¨å‡ºé—®é¢˜ä¸ä¼šæ‹–å®æ•´ä¸ªç³»ç»Ÿ

### 1.2 å®¹å™¨èµ„æºç±»å‹è¯¦è§£


**ğŸ”¸ CPUèµ„æº**
```
CPUèµ„æºå°±æ˜¯è®¡ç®—èƒ½åŠ›ï¼š
â€¢ CPUä»½é¢(shares)ï¼šç›¸å¯¹æƒé‡ï¼Œé»˜è®¤1024
â€¢ CPUæ ¸å¿ƒæ•°(cpus)ï¼šç»å¯¹é™åˆ¶ï¼Œå¦‚1.5ä¸ªCPUæ ¸å¿ƒ
â€¢ CPUå‘¨æœŸé™åˆ¶ï¼šæ›´ç²¾ç»†çš„æ§åˆ¶æ–¹å¼

ç±»æ¯”ç†è§£ï¼š
CPUä»½é¢ â†â†’ é£Ÿå ‚æ’é˜Ÿçš„ä¼˜å…ˆçº§
CPUæ ¸å¿ƒæ•° â†â†’ åˆ†é…ç»™ä½ çš„å…·ä½“é¤å…·æ•°é‡
```

**ğŸ”¸ å†…å­˜èµ„æº**
```
å†…å­˜å°±æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„å­˜å‚¨ç©ºé—´ï¼š
â€¢ ç‰©ç†å†…å­˜é™åˆ¶ï¼šå®é™…RAMä½¿ç”¨é‡
â€¢ äº¤æ¢å†…å­˜é™åˆ¶ï¼šè™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡
â€¢ å†…å­˜äº¤æ¢æ§åˆ¶ï¼šæ˜¯å¦å…è®¸ä½¿ç”¨swap

ç±»æ¯”ç†è§£ï¼š
ç‰©ç†å†…å­˜ â†â†’ ä½ æ¡Œå­ä¸Šçš„å®é™…å·¥ä½œç©ºé—´
äº¤æ¢å†…å­˜ â†â†’ ä¸´æ—¶å€Ÿç”¨çš„é¢å¤–æ¡Œé¢ç©ºé—´
```

**ğŸ”¸ ç£ç›˜IOèµ„æº**
```
ç£ç›˜IOå°±æ˜¯è¯»å†™ç¡¬ç›˜çš„é€Ÿåº¦ï¼š
â€¢ è¯»å–é€Ÿåº¦é™åˆ¶(read_bps)ï¼šæ¯ç§’è¯»å–å­—èŠ‚æ•°
â€¢ å†™å…¥é€Ÿåº¦é™åˆ¶(write_bps)ï¼šæ¯ç§’å†™å…¥å­—èŠ‚æ•°
â€¢ IOæ“ä½œé™åˆ¶(read_iops/write_iops)ï¼šæ¯ç§’IOæ“ä½œæ¬¡æ•°
```

### 1.3 èµ„æºé™åˆ¶çš„ä¸¤ç§æ¨¡å¼


**ğŸ“‹ è½¯é™åˆ¶ vs ç¡¬é™åˆ¶**

| é™åˆ¶ç±»å‹ | **å·¥ä½œæ–¹å¼** | **è¶…å‡ºåæœ** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| ğŸŸ¡ **è½¯é™åˆ¶(requests)** | `èµ„æºé¢„ç•™ï¼Œå¯ä»¥è¶…å‡º` | `æ€§èƒ½ä¸‹é™ï¼Œä¸ä¼šè¢«æ€æ­»` | `èµ„æºè§„åˆ’ï¼Œä¿è¯æœ€ä½éœ€æ±‚` |
| ğŸ”´ **ç¡¬é™åˆ¶(limits)** | `ç»å¯¹ä¸èƒ½è¶…å‡º` | `è¿›ç¨‹è¢«æ€æ­»(OOM Killed)` | `é˜²æ­¢èµ„æºæ»¥ç”¨` |

```
é¤å…ç±»æ¯”ï¼š
è½¯é™åˆ¶ â†â†’ é¢„è®¢æ¡Œä½(ä¿è¯æœ‰ä½ç½®ï¼Œä½†å¯ä»¥ä¸´æ—¶åŠ æ¤…å­)
ç¡¬é™åˆ¶ â†â†’ åŒ…é—´æœ€å¤§äººæ•°(ç»å¯¹ä¸èƒ½è¶…è¿‡ï¼Œå¦åˆ™è¿åæ¶ˆé˜²è§„å®š)
```

---

## 2. ğŸ‹ Dockerå®¹å™¨èµ„æºé™åˆ¶


### 2.1 å†…å­˜é™åˆ¶å‚æ•°è¯¦è§£


**ğŸ”¸ --memoryå‚æ•°ä½¿ç”¨**

```bash
# åŸºæœ¬å†…å­˜é™åˆ¶
docker run --memory=512m nginx
# è§£é‡Šï¼šé™åˆ¶å®¹å™¨æœ€å¤šä½¿ç”¨512MBå†…å­˜

# å†…å­˜ + swapé™åˆ¶
docker run --memory=512m --memory-swap=1g nginx  
# è§£é‡Šï¼šç‰©ç†å†…å­˜512Mï¼Œswapç©ºé—´512M(æ€»å…±1G-512M=512M swap)

# ç¦ç”¨swap
docker run --memory=512m --memory-swap=512m nginx
# è§£é‡Šï¼šswapè®¾ç½®å’Œmemoryç›¸åŒï¼Œè¡¨ç¤ºç¦ç”¨swap
```

**ğŸ’¡ å†…å­˜é™åˆ¶å®é™…æ¡ˆä¾‹**ï¼š
```bash
# åœºæ™¯ï¼šéƒ¨ç½²ä¸€ä¸ªJavaåº”ç”¨å®¹å™¨
docker run -d \
  --name java-app \
  --memory=2g \
  --memory-swap=3g \
  -e JAVA_OPTS="-Xmx1536m" \
  my-java-app

# è§£é‡Šè¯´æ˜ï¼š
# --memory=2g: å®¹å™¨æœ€å¤šç”¨2Gç‰©ç†å†…å­˜
# --memory-swap=3g: æ€»å…±(ç‰©ç†+swap)æœ€å¤š3Gï¼Œæ‰€ä»¥swap=1G
# -Xmx1536m: JVMå †å†…å­˜1.5Gï¼Œä¸ºç³»ç»Ÿå’Œå…¶ä»–è¿›ç¨‹é¢„ç•™0.5G
```

### 2.2 CPUé™åˆ¶å‚æ•°è¯¦è§£


**ğŸ”¸ --cpuså‚æ•°ä½¿ç”¨**

```bash
# CPUæ ¸å¿ƒæ•°é™åˆ¶
docker run --cpus="1.5" nginx
# è§£é‡Šï¼šå®¹å™¨æœ€å¤šä½¿ç”¨1.5ä¸ªCPUæ ¸å¿ƒ

# CPUä»½é¢æƒé‡
docker run --cpu-shares=512 nginx
# è§£é‡Šï¼šCPUä»½é¢æƒé‡512(é»˜è®¤1024)ï¼Œç›¸å½“äº50%ä¼˜å…ˆçº§
```

**ğŸ”¸ --cpu-sharesæƒé‡é…ç½®å®è·µ**

```bash
# åœºæ™¯ï¼šè¿è¡Œ3ä¸ªä¸åŒä¼˜å…ˆçº§çš„æœåŠ¡
# é«˜ä¼˜å…ˆçº§WebæœåŠ¡
docker run -d --name web-server --cpu-shares=2048 nginx

# ä¸­ä¼˜å…ˆçº§APIæœåŠ¡  
docker run -d --name api-server --cpu-shares=1024 my-api

# ä½ä¼˜å…ˆçº§åå°ä»»åŠ¡
docker run -d --name background-job --cpu-shares=512 my-job

# æƒé‡æ¯”ä¾‹ï¼šweb(2048) : api(1024) : job(512) = 4:2:1
# å½“CPUç«äº‰æ—¶ï¼ŒwebæœåŠ¡è·å¾—4/7çš„CPUï¼Œapiè·å¾—2/7ï¼Œjobè·å¾—1/7
```

**âš ï¸ CPUé™åˆ¶é‡è¦åŒºåˆ«**ï¼š
```
--cpus vs --cpu-sharesçš„åŒºåˆ«ï¼š

--cpus="1.5"ï¼š
âœ… ç¡¬é™åˆ¶ï¼šç»å¯¹ä¸èƒ½è¶…è¿‡1.5ä¸ªCPUæ ¸å¿ƒ
âœ… é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ä¸¥æ ¼æ§åˆ¶CPUä½¿ç”¨é‡

--cpu-shares=1024ï¼š  
âœ… è½¯é™åˆ¶ï¼šåªåœ¨CPUç«äº‰æ—¶ç”Ÿæ•ˆ
âœ… é€‚ç”¨åœºæ™¯ï¼šè®¾ç½®æœåŠ¡ä¼˜å…ˆçº§ï¼ŒCPUç©ºé—²æ—¶å¯ä»¥ä½¿ç”¨æ›´å¤š
```

### 2.3 ç£ç›˜IOé™åˆ¶


**ğŸ”¸ ç£ç›˜IOé€Ÿåº¦æ§åˆ¶**

```bash
# é™åˆ¶è¯»å†™é€Ÿåº¦
docker run -d \
  --device-read-bps=/dev/sda:1mb \
  --device-write-bps=/dev/sda:1mb \
  --name io-limited-app \
  my-app

# è§£é‡Šï¼šé™åˆ¶å¯¹/dev/sdaè®¾å¤‡çš„è¯»å†™é€Ÿåº¦éƒ½æ˜¯1MB/s
```

**ğŸ”¸ IOPSæ“ä½œé™åˆ¶**

```bash
# é™åˆ¶IOæ“ä½œæ¬¡æ•°
docker run -d \
  --device-read-iops=/dev/sda:1000 \
  --device-write-iops=/dev/sda:1000 \
  --name iops-limited-app \
  my-app

# è§£é‡Šï¼šé™åˆ¶æ¯ç§’æœ€å¤š1000æ¬¡è¯»æ“ä½œå’Œ1000æ¬¡å†™æ“ä½œ
```

### 2.4 ç»¼åˆèµ„æºé™åˆ¶ç¤ºä¾‹


```bash
# ç”Ÿäº§ç¯å¢ƒWebåº”ç”¨å®Œæ•´é…ç½®
docker run -d \
  --name production-web \
  --memory=4g \
  --memory-swap=6g \
  --cpus="2.0" \
  --cpu-shares=1024 \
  --device-read-bps=/dev/sda:50mb \
  --device-write-bps=/dev/sda:50mb \
  --restart=unless-stopped \
  -p 80:8080 \
  my-web-app

# é…ç½®è§£é‡Šï¼š
# å†…å­˜ï¼š4Gç‰©ç†å†…å­˜ï¼Œ2G swapç©ºé—´
# CPUï¼šæœ€å¤š2ä¸ªCPUæ ¸å¿ƒï¼Œæ ‡å‡†ä¼˜å…ˆçº§
# ç£ç›˜IOï¼šè¯»å†™é€Ÿåº¦å„50MB/s
# é‡å¯ç­–ç•¥ï¼šå¼‚å¸¸æ—¶è‡ªåŠ¨é‡å¯
```

---

## 3. â˜¸ï¸ Kubernetesèµ„æºç®¡ç†


### 3.1 Podèµ„æºrequests/limitsæ¦‚å¿µ


**ğŸ”¸ requestså’Œlimitsçš„åŒºåˆ«**

```yaml
# Podèµ„æºé…ç½®ç¤ºä¾‹
apiVersion: v1
kind: Pod
metadata:
  name: resource-demo
spec:
  containers:
  - name: app
    image: nginx
    resources:
      requests:    # è½¯é™åˆ¶ï¼šèµ„æºé¢„ç•™
        memory: "256Mi"
        cpu: "250m"
      limits:      # ç¡¬é™åˆ¶ï¼šæœ€å¤§èµ„æº
        memory: "512Mi" 
        cpu: "500m"
```

**é€šä¿—ç†è§£requestså’Œlimits**ï¼š
```
é…’åº—é¢„è®¢ç±»æ¯”ï¼š
requests â†â†’ é¢„è®¢æ ‡å‡†é—´(ä¿è¯ç»™ä½ è¿™ä¸ªæˆ¿é—´)
limits â†â†’ æˆ¿é—´æœ€å¤§å…¥ä½äººæ•°(ç»å¯¹ä¸èƒ½è¶…è¿‡)

å®é™…æ•ˆæœï¼š
â€¢ requestsï¼šKubernetesè°ƒåº¦æ—¶ä¿è¯èŠ‚ç‚¹æœ‰è¶³å¤Ÿèµ„æº
â€¢ limitsï¼šè¿è¡Œæ—¶å¦‚æœè¶…è¿‡limitsï¼Œå®¹å™¨å¯èƒ½è¢«æ€æ­»
```

### 3.2 CPUèµ„æºå•ä½è¯´æ˜


**ğŸ”¸ CPUèµ„æºçš„è¡¨ç¤ºæ–¹æ³•**

```
CPUå•ä½æ¢ç®—ï¼š
1 CPU = 1000m (millicores)
0.5 CPU = 500m
0.1 CPU = 100m

å®é™…å«ä¹‰ï¼š
"250m" â†â†’ 0.25ä¸ªCPUæ ¸å¿ƒ â†â†’ 25%çš„å•æ ¸æ€§èƒ½
"1000m" â†â†’ 1ä¸ªå®Œæ•´CPUæ ¸å¿ƒ â†â†’ 100%å•æ ¸æ€§èƒ½
```

**ğŸ’¡ CPUèµ„æºé…ç½®å»ºè®®**ï¼š
```yaml
# ä¸åŒç±»å‹åº”ç”¨çš„å…¸å‹é…ç½®
# Webå‰ç«¯åº”ç”¨
resources:
  requests:
    cpu: "100m"      # é¢„ç•™10%CPU
    memory: "128Mi"   # é¢„ç•™128MBå†…å­˜
  limits:
    cpu: "500m"      # æœ€å¤š50%CPU  
    memory: "512Mi"   # æœ€å¤š512MBå†…å­˜

# Javaåç«¯åº”ç”¨
resources:
  requests:
    cpu: "500m"      # é¢„ç•™50%CPU
    memory: "1Gi"     # é¢„ç•™1GBå†…å­˜
  limits:
    cpu: "2000m"     # æœ€å¤š2ä¸ªCPUæ ¸å¿ƒ
    memory: "4Gi"     # æœ€å¤š4GBå†…å­˜
```

### 3.3 Kubernetesèµ„æºé…é¢


**ğŸ”¸ Namespaceçº§åˆ«èµ„æºé…é¢**

```yaml
# åˆ›å»ºèµ„æºé…é¢
apiVersion: v1
kind: ResourceQuota
metadata:
  name: compute-quota
  namespace: development
spec:
  hard:
    requests.cpu: "4"        # è¯¥å‘½åç©ºé—´æ€»å…±é¢„ç•™4ä¸ªCPU
    requests.memory: 8Gi     # æ€»å…±é¢„ç•™8GBå†…å­˜
    limits.cpu: "8"          # æœ€å¤šä½¿ç”¨8ä¸ªCPU
    limits.memory: 16Gi      # æœ€å¤šä½¿ç”¨16GBå†…å­˜
    persistentvolumeclaims: "10"  # æœ€å¤š10ä¸ªPVC
    pods: "20"               # æœ€å¤š20ä¸ªPod
```

**ğŸ”¸ LimitRangeé™åˆ¶å•ä¸ªèµ„æº**

```yaml
# é™åˆ¶å•ä¸ªPod/Containerçš„èµ„æºèŒƒå›´
apiVersion: v1
kind: LimitRange
metadata:
  name: mem-limit-range
  namespace: development
spec:
  limits:
  - default:          # é»˜è®¤limits
      memory: "512Mi"
      cpu: "500m"
    defaultRequest:   # é»˜è®¤requests  
      memory: "256Mi"
      cpu: "250m"
    max:             # å•ä¸ªå®¹å™¨æœ€å¤§å€¼
      memory: "2Gi"
      cpu: "2000m"
    min:             # å•ä¸ªå®¹å™¨æœ€å°å€¼
      memory: "128Mi"
      cpu: "100m"
    type: Container
```

### 3.4 èµ„æºç®¡ç†æœ€ä½³å®è·µ


**âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®ç­–ç•¥**ï¼š

```yaml
# å…³é”®ä¸šåŠ¡åº”ç”¨é…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: critical-app
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: app
        image: my-critical-app
        resources:
          requests:
            memory: "1Gi"     # ä¿è¯èµ„æºï¼Œç”¨äºè°ƒåº¦å†³ç­–
            cpu: "500m"
          limits:  
            memory: "2Gi"     # é˜²æ­¢å†…å­˜æ³„æ¼
            cpu: "1000m"      # é˜²æ­¢CPUæ»¥ç”¨
        # å¥åº·æ£€æŸ¥
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
        readinessProbe:
          httpGet:
            path: /ready  
            port: 8080
```

---

## 4. ğŸ“Š å®¹å™¨èµ„æºç›‘æ§


### 4.1 Dockerå®¹å™¨ç›‘æ§


**ğŸ”¸ å®æ—¶ç›‘æ§å‘½ä»¤**

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker stats

# è¾“å‡ºæ ¼å¼ç¤ºä¾‹ï¼š
CONTAINER ID   NAME       CPU %     MEM USAGE / LIMIT     MEM %     NET I/O       BLOCK I/O     PIDS
1a2b3c4d5e6f   web-app    45.32%    512.5MiB / 2GiB      25.04%    1.2kB / 648B  4.1MB / 0B    12

# ç›‘æ§æŒ‡å®šå®¹å™¨
docker stats web-app api-server

# åªæ˜¾ç¤ºä¸€æ¬¡ç»“æœ(ä¸æŒç»­åˆ·æ–°)
docker stats --no-stream
```

**ğŸ”¸ è¯¦ç»†èµ„æºä¿¡æ¯**

```bash
# æŸ¥çœ‹å®¹å™¨è¯¦ç»†é…ç½®
docker inspect web-app | grep -A 10 "Memory\|Cpu"

# æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ä¿¡æ¯
docker exec web-app ps aux

# æŸ¥çœ‹å®¹å™¨å†…å­˜è¯¦æƒ…
docker exec web-app cat /proc/meminfo
```

### 4.2 ç³»ç»Ÿçº§ç›‘æ§å·¥å…·


**ğŸ”¸ cAdvisorå®¹å™¨ç›‘æ§**

```bash
# è¿è¡ŒcAdvisorç›‘æ§å®¹å™¨
docker run -d \
  --name=cadvisor \
  --restart=unless-stopped \
  -p 8080:8080 \
  -v /:/rootfs:ro \
  -v /var/run:/var/run:ro \
  -v /sys:/sys:ro \
  -v /var/lib/docker/:/var/lib/docker:ro \
  google/cadvisor:latest

# è®¿é—® http://localhost:8080 æŸ¥çœ‹ç›‘æ§ç•Œé¢
```

**ğŸ”¸ ç›‘æ§æŒ‡æ ‡è§£è¯»**

```
å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š

ğŸ“ˆ CPUä½¿ç”¨ç‡ï¼š
â€¢ æ­£å¸¸èŒƒå›´ï¼š10-70%
â€¢ å‘Šè­¦é˜ˆå€¼ï¼š>80%æŒç»­5åˆ†é’Ÿ
â€¢ å±é™©ä¿¡å·ï¼š>95%æˆ–é•¿æœŸ100%

ğŸ“ˆ å†…å­˜ä½¿ç”¨ç‡ï¼š
â€¢ æ­£å¸¸èŒƒå›´ï¼š30-80%
â€¢ å‘Šè­¦é˜ˆå€¼ï¼š>85%
â€¢ å±é™©ä¿¡å·ï¼š>95%(å¯èƒ½è§¦å‘OOM)

ğŸ“ˆ ç£ç›˜IOï¼š
â€¢ å…³æ³¨ç‚¹ï¼šIOPSå’Œå¸¦å®½ä½¿ç”¨ç‡
â€¢ å‘Šè­¦é˜ˆå€¼ï¼šIOç­‰å¾…æ—¶é—´>100ms

ğŸ“ˆ ç½‘ç»œIOï¼š
â€¢ å…³æ³¨ç‚¹ï¼šå¸¦å®½ä½¿ç”¨ç‡å’Œè¿æ¥æ•°
â€¢ å‘Šè­¦é˜ˆå€¼ï¼šä¸¢åŒ…ç‡>1%
```

### 4.3 Kubernetesç›‘æ§


**ğŸ”¸ kubectlç›‘æ§å‘½ä»¤**

```bash
# æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
kubectl top nodes

# è¾“å‡ºç¤ºä¾‹ï¼š
NAME       CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
master     250m         12%    1560Mi          20%
worker-1   890m         44%    3200Mi          40%
worker-2   1200m        60%    4100Mi          51%

# æŸ¥çœ‹Podèµ„æºä½¿ç”¨
kubectl top pods

# æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´çš„Pod
kubectl top pods -n production

# æŒ‰èµ„æºä½¿ç”¨æ’åº
kubectl top pods --sort-by=memory
kubectl top pods --sort-by=cpu
```

**ğŸ”¸ èµ„æºä½¿ç”¨è¯¦æƒ…**

```bash
# æŸ¥çœ‹Podèµ„æºé…ç½®å’Œå®é™…ä½¿ç”¨
kubectl describe pod my-app

# æŸ¥çœ‹èŠ‚ç‚¹ä¸Šè¿è¡Œçš„PodåŠèµ„æºåˆ†é…
kubectl describe node worker-1 | grep -A 5 "Allocated resources"

# ç›‘æ§ç‰¹å®šPodçš„æ—¥å¿—(æŸ¥çœ‹OOMç­‰é”™è¯¯)
kubectl logs -f my-app --previous
```

---

## 5. ğŸ”§ å®¹å™¨èµ„æºæ•…éšœæ’æŸ¥


### 5.1 å†…å­˜ç›¸å…³é—®é¢˜


**ğŸ”¸ OOM Killedæ•…éšœæ’æŸ¥**

```bash
# 1. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ä¸­çš„OOMè®°å½•
sudo dmesg | grep -i "killed process"
sudo journalctl -u docker | grep -i "oom"

# 2. æ£€æŸ¥å®¹å™¨é€€å‡ºçŠ¶æ€
docker ps -a
# é€€å‡ºçŠ¶æ€137é€šå¸¸è¡¨ç¤ºè¢«SIGKILLæ€æ­»(å¯èƒ½æ˜¯OOM)

# 3. æ£€æŸ¥å®¹å™¨å†…å­˜ä½¿ç”¨å†å²
docker stats --no-stream container-name
```

**ğŸ”¸ å†…å­˜æ³„æ¼è¯Šæ–­**

```bash
# è¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å­˜è¯¦æƒ…
docker exec -it my-app bash

# æŸ¥çœ‹è¿›ç¨‹å†…å­˜ä½¿ç”¨
ps aux --sort=-%mem | head -10

# æŸ¥çœ‹ç³»ç»Ÿå†…å­˜è¯¦æƒ…  
free -h
cat /proc/meminfo

# Javaåº”ç”¨å†…å­˜åˆ†æ
jmap -histo PID  # æ˜¾ç¤ºå¯¹è±¡å ç”¨å†…å­˜ç»Ÿè®¡
jstat -gc PID 5s # æ¯5ç§’æ˜¾ç¤ºGCæƒ…å†µ
```

### 5.2 CPUç›¸å…³é—®é¢˜


**ğŸ”¸ CPUä½¿ç”¨ç‡è¿‡é«˜æ’æŸ¥**

```bash
# æŸ¥çœ‹å®¹å™¨å†…CPUä½¿ç”¨æƒ…å†µ
docker exec my-app top -p 1

# æŸ¥çœ‹å…·ä½“è¿›ç¨‹CPUä½¿ç”¨
docker exec my-app ps -eo pid,ppid,cmd,%cpu --sort=-%cpu

# åˆ†æCPUå¯†é›†å‹è¿›ç¨‹
docker exec my-app strace -p PID  # è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨
```

**ğŸ”¸ CPUé™åˆ¶é—®é¢˜**

```bash
# æ£€æŸ¥CPUé™åˆ¶é…ç½®
docker inspect my-app | jq '.HostConfig.CpuShares'
docker inspect my-app | jq '.HostConfig.NanoCpus'

# å¯¹æ¯”CPUé™åˆ¶å’Œå®é™…ä½¿ç”¨
docker stats --format "table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}"
```

### 5.3 Kubernetesæ•…éšœæ’æŸ¥


**ğŸ”¸ Podè°ƒåº¦å¤±è´¥**

```bash
# æŸ¥çœ‹Podè°ƒåº¦çŠ¶æ€
kubectl get pods -o wide
kubectl describe pod my-app

# å¸¸è§é”™è¯¯ä¿¡æ¯è§£è¯»ï¼š
# "Insufficient memory" - èŠ‚ç‚¹å†…å­˜ä¸è¶³
# "Insufficient cpu" - èŠ‚ç‚¹CPUä¸è¶³  
# "PodExceedsFreeCPU" - è¶…å‡ºèŠ‚ç‚¹å¯ç”¨CPU

# æŸ¥çœ‹èŠ‚ç‚¹èµ„æºæƒ…å†µ
kubectl describe nodes | grep -A 5 "Allocated resources"
```

**ğŸ”¸ Pod OOMKilledæ•…éšœ**

```bash
# æŸ¥çœ‹Podäº‹ä»¶
kubectl get events --sort-by='.lastTimestamp' | grep my-app

# å…¸å‹OOMäº‹ä»¶ï¼š
# "Pod my-app was OOMKilled"
# "Container my-app exceeded memory limit"

# æ£€æŸ¥Podèµ„æºé™åˆ¶
kubectl get pod my-app -o yaml | grep -A 10 "resources:"

# æŸ¥çœ‹å†å²é€€å‡ºåŸå› 
kubectl describe pod my-app | grep -A 5 "Last State"
```

### 5.4 æ•…éšœæ’æŸ¥æµç¨‹


```
ğŸ”„ æ ‡å‡†æ•…éšœæ’æŸ¥æµç¨‹ï¼š

ç¬¬1æ­¥ ğŸ“‹ æ”¶é›†åŸºæœ¬ä¿¡æ¯
â”œâ”€ å®¹å™¨/Podå½“å‰çŠ¶æ€
â”œâ”€ èµ„æºé…ç½®ä¿¡æ¯
â””â”€ é”™è¯¯æ—¥å¿—å’Œäº‹ä»¶

ç¬¬2æ­¥ ğŸ” å®šä½é—®é¢˜ç±»å‹  
â”œâ”€ å†…å­˜é—®é¢˜ï¼šOOMã€å†…å­˜æ³„æ¼
â”œâ”€ CPUé—®é¢˜ï¼šé«˜è´Ÿè½½ã€é™æµ
â”œâ”€ IOé—®é¢˜ï¼šç£ç›˜æ»¡ã€IOé˜»å¡
â””â”€ ç½‘ç»œé—®é¢˜ï¼šè¿æ¥æ•°é™åˆ¶

ç¬¬3æ­¥ âš¡ å¿«é€Ÿæ¢å¤
â”œâ”€ é‡å¯å®¹å™¨/Pod
â”œâ”€ è°ƒæ•´èµ„æºé™åˆ¶
â”œâ”€ æ¨ªå‘æ‰©å®¹
â””â”€ é™çº§å¤„ç†

ç¬¬4æ­¥ ğŸ› ï¸ æ ¹å› åˆ†æ
â”œâ”€ ä»£ç é—®é¢˜ä¿®å¤
â”œâ”€ èµ„æºè§„åˆ’è°ƒæ•´  
â”œâ”€ ç›‘æ§å‘Šè­¦å®Œå–„
â””â”€ é¢„é˜²æªæ–½å»ºç«‹
```

---

## 6. ğŸš€ å®¹å™¨èµ„æºä¼˜åŒ–ç­–ç•¥


### 6.1 èµ„æºé…ç½®æœ€ä½³å®è·µ


**ğŸ”¸ åˆç†è®¾ç½®requestså’Œlimits**

```yaml
# ä¸åŒåº”ç”¨ç±»å‹çš„æ¨èé…ç½®
# Webå‰ç«¯åº”ç”¨(è½»é‡çº§)
resources:
  requests:
    cpu: "100m"      # 10% CPUé¢„ç•™
    memory: "128Mi"   # 128MBå†…å­˜é¢„ç•™
  limits:
    cpu: "500m"      # æœ€å¤š50% CPU
    memory: "512Mi"   # æœ€å¤š512MBå†…å­˜

# APIæœåŠ¡(ä¸­ç­‰è´Ÿè½½)  
resources:
  requests:
    cpu: "250m"      # 25% CPUé¢„ç•™
    memory: "512Mi"   # 512MBå†…å­˜é¢„ç•™
  limits:
    cpu: "1000m"     # æœ€å¤š1ä¸ªCPUæ ¸å¿ƒ
    memory: "2Gi"     # æœ€å¤š2GBå†…å­˜

# æ•°æ®åº“(é«˜èµ„æºéœ€æ±‚)
resources:
  requests:
    cpu: "1000m"     # 1ä¸ªCPUæ ¸å¿ƒé¢„ç•™
    memory: "2Gi"     # 2GBå†…å­˜é¢„ç•™
  limits:
    cpu: "4000m"     # æœ€å¤š4ä¸ªCPUæ ¸å¿ƒ
    memory: "8Gi"     # æœ€å¤š8GBå†…å­˜
```

**ğŸ’¡ é…ç½®åŸåˆ™**ï¼š
- **requestsè®¾ç½®ä¸ºå®é™…éœ€è¦çš„70-80%**ï¼šä¿è¯è°ƒåº¦æˆåŠŸ
- **limitsè®¾ç½®ä¸ºrequestsçš„1.5-2å€**ï¼šå…è®¸çªå‘å¤„ç†
- **é¿å…è®¾ç½®è¿‡é«˜limits**ï¼šé˜²æ­¢å•ä¸ªå®¹å™¨å½±å“æ•´ä½“æ€§èƒ½
- **ç›‘æ§å®é™…ä½¿ç”¨æƒ…å†µ**ï¼šæ ¹æ®ç›‘æ§æ•°æ®è°ƒæ•´é…ç½®

### 6.2 åº”ç”¨å±‚é¢ä¼˜åŒ–


**ğŸ”¸ JVMåº”ç”¨ä¼˜åŒ–**

```bash
# Javaåº”ç”¨å†…å­˜é…ç½®ä¼˜åŒ–
docker run -d \
  --name java-app \
  --memory=4g \
  --memory-swap=4g \
  -e JAVA_OPTS="-Xms2g -Xmx3g -XX:+UseG1GC" \
  my-java-app

# å‚æ•°è§£é‡Šï¼š
# å®¹å™¨å†…å­˜é™åˆ¶ï¼š4GB
# JVMå †å†…å­˜ï¼šæœ€å°2GBï¼Œæœ€å¤§3GB
# é¢„ç•™1GBç»™ç³»ç»Ÿå’Œéå †å†…å­˜
# ä½¿ç”¨G1GCæé«˜GCæ€§èƒ½
```

**ğŸ”¸ Node.jsåº”ç”¨ä¼˜åŒ–**

```bash
# Node.jsåº”ç”¨å†…å­˜ä¼˜åŒ–
docker run -d \
  --name node-app \
  --memory=1g \
  --memory-swap=1g \
  -e NODE_OPTIONS="--max-old-space-size=768" \
  my-node-app

# å‚æ•°è§£é‡Šï¼š
# å®¹å™¨å†…å­˜é™åˆ¶ï¼š1GB
# Node.jså †å†…å­˜ï¼š768MB
# é¢„ç•™çº¦256MBç»™ç³»ç»Ÿå’Œå…¶ä»–å†…å­˜
```

### 6.3 é›†ç¾¤å±‚é¢ä¼˜åŒ–


**ğŸ”¸ èŠ‚ç‚¹èµ„æºè§„åˆ’**

```yaml
# ç”Ÿäº§ç¯å¢ƒèŠ‚ç‚¹æ ‡ç­¾å’Œæ±¡ç‚¹
# ä¸ºä¸åŒç±»å‹åº”ç”¨åˆ†é…ä¸“ç”¨èŠ‚ç‚¹
kubectl label nodes worker-1 workload-type=web
kubectl label nodes worker-2 workload-type=database
kubectl label nodes worker-3 workload-type=batch

# é«˜æ€§èƒ½åº”ç”¨è°ƒåº¦åˆ°ä¸“ç”¨èŠ‚ç‚¹
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      nodeSelector:
        workload-type: database  # è°ƒåº¦åˆ°æ•°æ®åº“ä¸“ç”¨èŠ‚ç‚¹
      tolerations:
      - key: workload-type
        operator: Equal
        value: database
        effect: NoSchedule
```

**ğŸ”¸ æ°´å¹³æ‰©ç¼©å®¹é…ç½®**

```yaml
# HPAè‡ªåŠ¨æ‰©ç¼©å®¹é…ç½®
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: web-app-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: web-app
  minReplicas: 2          # æœ€å°‘2ä¸ªå‰¯æœ¬
  maxReplicas: 10         # æœ€å¤š10ä¸ªå‰¯æœ¬
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70    # CPUä½¿ç”¨ç‡è¶…è¿‡70%æ‰©å®¹
  - type: Resource  
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80    # å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%æ‰©å®¹
```

### 6.4 æˆæœ¬ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ å¤šç¯å¢ƒèµ„æºé…ç½®**

```yaml
# å¼€å‘ç¯å¢ƒ - èµ„æºæœ€å°åŒ–
resources:
  requests:
    cpu: "50m"       # 5% CPU
    memory: "64Mi"    # 64MBå†…å­˜
  limits:
    cpu: "200m"      # 20% CPU  
    memory: "256Mi"   # 256MBå†…å­˜

# æµ‹è¯•ç¯å¢ƒ - ä¸­ç­‰é…ç½®
resources:
  requests:
    cpu: "100m"      # 10% CPU
    memory: "128Mi"   # 128MBå†…å­˜
  limits:
    cpu: "500m"      # 50% CPU
    memory: "1Gi"     # 1GBå†…å­˜

# ç”Ÿäº§ç¯å¢ƒ - å……è¶³é…ç½®
resources:
  requests:
    cpu: "250m"      # 25% CPU
    memory: "512Mi"   # 512MBå†…å­˜
  limits:
    cpu: "1000m"     # 100% CPU
    memory: "4Gi"     # 4GBå†…å­˜
```

**ğŸ’° æˆæœ¬æ§åˆ¶å»ºè®®**ï¼š
- **æŒ‰ç¯å¢ƒå·®å¼‚åŒ–é…ç½®**ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨æœ€å°èµ„æº
- **å®šæœŸå›æ”¶é—²ç½®èµ„æº**ï¼šæ¸…ç†ä¸å¿…è¦çš„å®¹å™¨å’Œå­˜å‚¨
- **ä½¿ç”¨Spotå®ä¾‹**ï¼šéå…³é”®å·¥ä½œè´Ÿè½½ä½¿ç”¨æ›´ä¾¿å®œçš„SpotèŠ‚ç‚¹
- **èµ„æºä½¿ç”¨ç›‘æ§**ï¼šå»ºç«‹èµ„æºä½¿ç”¨æƒ…å†µæŠ¥è¡¨ï¼Œè¯†åˆ«æµªè´¹

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ èµ„æºé™åˆ¶æœ¬è´¨ï¼šç»™å®¹å™¨åˆ†é…å›ºå®šçš„ç³»ç»Ÿèµ„æºï¼Œé˜²æ­¢ç›¸äº’å½±å“
ğŸ”¸ ä¸¤ç§é™åˆ¶æ¨¡å¼ï¼šè½¯é™åˆ¶(requests)ä¿è¯æœ€å°èµ„æºï¼Œç¡¬é™åˆ¶(limits)é˜²æ­¢è¶…ç”¨
ğŸ”¸ Dockerå‚æ•°ï¼š--memory/--cpusæ§åˆ¶èµ„æºä¸Šé™ï¼Œ--cpu-sharesæ§åˆ¶ç›¸å¯¹ä¼˜å…ˆçº§
ğŸ”¸ K8sèµ„æºç®¡ç†ï¼šPodçº§åˆ«requests/limitsï¼Œå‘½åç©ºé—´çº§åˆ«ResourceQuota
ğŸ”¸ ç›‘æ§é‡è¦æ€§ï¼šæŒç»­ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦èµ„æºé™åˆ¶**ï¼š
```
é˜²æ­¢æ•…éšœè”“å»¶ï¼š
â€¢ ä¸€ä¸ªå®¹å™¨å†…å­˜æ³„æ¼ä¸ä¼šæ‹–å®æ•´ä¸ªæœåŠ¡å™¨
â€¢ CPUå¯†é›†ä»»åŠ¡ä¸ä¼šå½±å“å…¶ä»–åº”ç”¨å“åº”é€Ÿåº¦
â€¢ æ¶æ„æˆ–å¼‚å¸¸è¿›ç¨‹æ— æ³•æ¶ˆè€—æ‰€æœ‰ç³»ç»Ÿèµ„æº

æé«˜èµ„æºåˆ©ç”¨ç‡ï¼š
â€¢ åˆç†åˆ†é…èµ„æºï¼Œé¿å…èµ„æºæµªè´¹
â€¢ æ”¯æŒæ›´å¤šåº”ç”¨åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œ
â€¢ å®ç°æˆæœ¬æ§åˆ¶å’Œå®¹é‡è§„åˆ’
```

**ğŸ”¹ Docker vs Kubernetesèµ„æºç®¡ç†**ï¼š
```
Dockerèµ„æºé™åˆ¶ï¼š
â€¢ é€‚ç”¨äºå•æœºéƒ¨ç½²
â€¢ é…ç½®ç›¸å¯¹ç®€å•
â€¢ ä¸»è¦é€šè¿‡è¿è¡Œå‚æ•°æ§åˆ¶

Kubernetesèµ„æºç®¡ç†ï¼š
â€¢ é€‚ç”¨äºé›†ç¾¤éƒ¨ç½²  
â€¢ åŠŸèƒ½æ›´å¼ºå¤§å®Œæ•´
â€¢ æ”¯æŒé…é¢ã€è‡ªåŠ¨æ‰©ç¼©å®¹ç­‰é«˜çº§åŠŸèƒ½
```

**ğŸ”¹ ç›‘æ§å’Œæ•…éšœæ’æŸ¥çš„é‡è¦æ€§**ï¼š
```
é¢„é˜²æ€§ç›‘æ§ï¼š
â€¢ æå‰å‘ç°èµ„æºç“¶é¢ˆ
â€¢ é¿å…ç”Ÿäº§æ•…éšœå‘ç”Ÿ
â€¢ ä¸ºå®¹é‡è§„åˆ’æä¾›æ•°æ®æ”¯æŒ

æ•…éšœå¿«é€Ÿå¤„ç†ï¼š
â€¢ å¿«é€Ÿå®šä½é—®é¢˜æ ¹å› 
â€¢ ç¼©çŸ­æ•…éšœæ¢å¤æ—¶é—´
â€¢ å‡å°‘ä¸šåŠ¡å½±å“
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âš¡ ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
- **åˆ†å±‚è®¾ç½®èµ„æºé™åˆ¶**ï¼šåº”ç”¨å±‚ã€å®¹å™¨å±‚ã€é›†ç¾¤å±‚å¤šé‡ä¿éšœ
- **å»ºç«‹ç›‘æ§å‘Šè­¦**ï¼šèµ„æºä½¿ç”¨ç‡ã€OOMäº‹ä»¶ã€æ€§èƒ½æŒ‡æ ‡
- **åˆ¶å®šåº”æ€¥é¢„æ¡ˆ**ï¼šæ•…éšœæ—¶çš„å¿«é€Ÿå¤„ç†æµç¨‹
- **å®šæœŸä¼˜åŒ–è°ƒæ•´**ï¼šæ ¹æ®å®é™…è¿è¡Œæ•°æ®ä¼˜åŒ–èµ„æºé…ç½®

**ğŸ¯ å­¦ä¹ è·¯å¾„å»ºè®®**ï¼š
1. **ç†è§£åŸºæœ¬æ¦‚å¿µ**ï¼šä»€ä¹ˆæ˜¯èµ„æºé™åˆ¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦
2. **æŒæ¡é…ç½®æ–¹æ³•**ï¼šDockerå’ŒKubernetesçš„å…·ä½“å‚æ•°
3. **å­¦ä¼šç›‘æ§æ’æŸ¥**ï¼šä½¿ç”¨å·¥å…·ç›‘æ§å’Œè§£å†³é—®é¢˜
4. **å®è·µä¼˜åŒ–ç­–ç•¥**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨æœ€ä½³å®è·µ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å®¹å™¨èµ„æºè¦é™åˆ¶ï¼Œé˜²æ­¢å•ä¸ªå½±å“å…¨å±€
- requestsä¿æœ€å°ï¼Œlimitsé˜²è¶…æ ‡
- ç›‘æ§å‘Šè­¦ä¸å¯å°‘ï¼Œæ•…éšœæ’æŸ¥æœ‰æŠ€å·§
- ä¼˜åŒ–é…ç½®éœ€å®è·µï¼Œæˆæœ¬æ€§èƒ½ä¸¤æ‰‹æŠ“