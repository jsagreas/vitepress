---
title: 11ã€è¿è¡Œæ—¶å®‰å…¨ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [è¿è¡Œæ—¶å®‰å…¨ç›‘æ§æ¦‚è¿°](#1-è¿è¡Œæ—¶å®‰å…¨ç›‘æ§æ¦‚è¿°)
2. [æœåŠ¡è¿è¡ŒçŠ¶æ€ç›‘æ§](#2-æœåŠ¡è¿è¡ŒçŠ¶æ€ç›‘æ§)
3. [å¼‚å¸¸è¡Œä¸ºæ£€æµ‹æœºåˆ¶](#3-å¼‚å¸¸è¡Œä¸ºæ£€æµ‹æœºåˆ¶)
4. [èµ„æºä½¿ç”¨å¼‚å¸¸å‘Šè­¦](#4-èµ„æºä½¿ç”¨å¼‚å¸¸å‘Šè­¦)
5. [æƒé™æå‡æ£€æµ‹](#5-æƒé™æå‡æ£€æµ‹)
6. [ç½‘ç»œè¿æ¥å¼‚å¸¸ç›‘æ§](#6-ç½‘ç»œè¿æ¥å¼‚å¸¸ç›‘æ§)
7. [æ–‡ä»¶è®¿é—®è¡Œä¸ºå®¡è®¡](#7-æ–‡ä»¶è®¿é—®è¡Œä¸ºå®¡è®¡)
8. [è¿›ç¨‹è¡Œä¸ºåŸºçº¿å»ºç«‹](#8-è¿›ç¨‹è¡Œä¸ºåŸºçº¿å»ºç«‹)
9. [å®‰å…¨äº‹ä»¶å“åº”æµç¨‹](#9-å®‰å…¨äº‹ä»¶å“åº”æµç¨‹)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ è¿è¡Œæ—¶å®‰å…¨ç›‘æ§æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è¿è¡Œæ—¶å®‰å…¨ç›‘æ§


**ç®€å•ç†è§£**ï¼šå°±åƒç»™Linuxç³»ç»Ÿå®‰è£…äº†ä¸€å¥—"ç›‘æ§æ‘„åƒå¤´"ï¼Œå®æ—¶è§‚å¯Ÿç³»ç»Ÿçš„è¿è¡Œæƒ…å†µï¼Œä¸€æ—¦å‘ç°å¼‚å¸¸å°±ç«‹å³æŠ¥è­¦ã€‚

```
ä¼ ç»Ÿå®‰å…¨é˜²æŠ¤ï¼ˆé™æ€ï¼‰          è¿è¡Œæ—¶ç›‘æ§ï¼ˆåŠ¨æ€ï¼‰
       é˜²ç«å¢™                    å®æ—¶ç›‘æ§è¿›ç¨‹
       æ€æ¯’è½¯ä»¶          vs      å¼‚å¸¸è¡Œä¸ºæ£€æµ‹  
       è®¿é—®æ§åˆ¶                  èµ„æºä½¿ç”¨ç›‘æ§
                                ç½‘ç»œæµé‡åˆ†æ
```

**æ ¸å¿ƒç›®æ ‡**ï¼š
- **å®æ—¶å‘ç°** - ç³»ç»Ÿè¿è¡Œä¸­çš„å®‰å…¨å¨èƒ
- **å¿«é€Ÿå“åº”** - ç¬¬ä¸€æ—¶é—´å¤„ç†å¼‚å¸¸æƒ…å†µ  
- **é¢„é˜²æŸå¤±** - é¿å…å®‰å…¨äº‹ä»¶é€ æˆä¸¥é‡åæœ
- **æŒç»­æ”¹è¿›** - é€šè¿‡ç›‘æ§æ•°æ®ä¼˜åŒ–å®‰å…¨ç­–ç•¥

### 1.2 ç›‘æ§ä½“ç³»æ¶æ„


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è¿è¡Œæ—¶å®‰å…¨ç›‘æ§ç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®æ”¶é›†å±‚    â”‚  åˆ†æå¤„ç†å±‚    â”‚  å‘Šè­¦å“åº”å±‚    â”‚  å±•ç¤ºå±‚  â”‚
â”‚               â”‚               â”‚               â”‚         â”‚
â”‚ â€¢ ç³»ç»Ÿè°ƒç”¨ç›‘æ§ â”‚ â€¢ è¡Œä¸ºåˆ†æå¼•æ“ â”‚ â€¢ å‘Šè­¦è§„åˆ™å¼•æ“ â”‚ â€¢ ç›‘æ§é¢æ¿â”‚
â”‚ â€¢ è¿›ç¨‹ç›‘æ§    â”‚ â€¢ å¼‚å¸¸æ£€æµ‹ç®—æ³• â”‚ â€¢ è‡ªåŠ¨å“åº”æœºåˆ¶ â”‚ â€¢ æŠ¥è¡¨ç»Ÿè®¡â”‚
â”‚ â€¢ ç½‘ç»œç›‘æ§    â”‚ â€¢ åŸºçº¿å¯¹æ¯”    â”‚ â€¢ é€šçŸ¥æœºåˆ¶    â”‚ â€¢ è¶‹åŠ¿åˆ†æâ”‚
â”‚ â€¢ æ–‡ä»¶ç›‘æ§    â”‚ â€¢ å…³è”åˆ†æ    â”‚ â€¢ äº‹ä»¶è®°å½•    â”‚ â€¢ é…ç½®ç•Œé¢â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Linuxæ“ä½œç³»ç»Ÿ                        â”‚
â”‚  è¿›ç¨‹ | æ–‡ä»¶ç³»ç»Ÿ | ç½‘ç»œæœåŠ¡ | ç”¨æˆ·ä¼šè¯ | ç³»ç»Ÿèµ„æº         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ç›‘æ§çš„é‡è¦æ€§


> **ä¸ºä»€ä¹ˆéœ€è¦è¿è¡Œæ—¶ç›‘æ§ï¼Ÿ**
> 
> ä¼ ç»Ÿçš„é˜²æŠ¤æªæ–½å°±åƒåŸå¢™ï¼Œåªèƒ½é˜²æ­¢å¤–éƒ¨æ”»å‡»ã€‚ä½†å¦‚æœæ•Œäººå·²ç»è¿›å…¥åŸå†…ï¼Œæˆ–è€…å†…éƒ¨æœ‰å›å¾’ï¼Œå°±éœ€è¦å·¡é€»å…µå®æ—¶ç›‘æ§åŸå†…çš„æƒ…å†µã€‚è¿è¡Œæ—¶ç›‘æ§å°±æ˜¯è¿™ä¸ª"å·¡é€»å…µ"ã€‚

**å®é™…æ„ä¹‰**ï¼š
- **å†…éƒ¨å¨èƒæ£€æµ‹** - å‘ç°å†…éƒ¨ç”¨æˆ·çš„æ¶æ„è¡Œä¸º
- **APTæ”»å‡»é˜²æŠ¤** - æ£€æµ‹é•¿æœŸæ½œä¼çš„é«˜çº§å¨èƒ
- **åˆè§„æ€§è¦æ±‚** - æ»¡è¶³å®‰å…¨å®¡è®¡å’Œåˆè§„æ ‡å‡†
- **æ•…éšœé¢„è­¦** - æå‰å‘ç°ç³»ç»Ÿæ•…éšœå¾å…†

---

## 2. ğŸ” æœåŠ¡è¿è¡ŒçŠ¶æ€ç›‘æ§


### 2.1 ä»€ä¹ˆæ˜¯æœåŠ¡è¿è¡ŒçŠ¶æ€ç›‘æ§


**é€šä¿—è§£é‡Š**ï¼šå°±åƒåŒ»ç”Ÿå®šæœŸæ£€æŸ¥ç—…äººçš„ç”Ÿå‘½ä½“å¾ï¼ˆå¿ƒè·³ã€è¡€å‹ã€ä½“æ¸©ï¼‰ï¼Œç›‘æ§ç³»ç»Ÿéœ€è¦å®æ—¶æ£€æŸ¥å„ä¸ªæœåŠ¡çš„"å¥åº·çŠ¶å†µ"ã€‚

### 2.2 æ ¸å¿ƒç›‘æ§æŒ‡æ ‡


**ğŸ”¸ æœåŠ¡å¯ç”¨æ€§ç›‘æ§**
```bash
# æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
systemctl status nginx
systemctl is-active nginx
systemctl is-enabled nginx

# æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€  
netstat -tlnp | grep :80
ss -tlnp | grep :80
```

**ç›‘æ§ç»´åº¦**ï¼š

| ç›‘æ§é¡¹ç›® | **æ­£å¸¸çŠ¶æ€** | **å¼‚å¸¸çŠ¶æ€** | **æ£€æµ‹æ–¹æ³•** |
|---------|------------|------------|------------|
| ğŸŸ¢ **æœåŠ¡çŠ¶æ€** | `active (running)` | `failed/inactive` | `systemctl status` |
| ğŸŸ¢ **è¿›ç¨‹å­˜åœ¨** | `è¿›ç¨‹ID > 0` | `è¿›ç¨‹ä¸å­˜åœ¨` | `ps aux \| grep` |
| ğŸŸ¢ **ç«¯å£ç›‘å¬** | `LISTENçŠ¶æ€` | `ç«¯å£æœªç›‘å¬` | `netstat/ss` |
| ğŸŸ¢ **å“åº”æ—¶é—´** | `< 3ç§’` | `> 10ç§’æˆ–è¶…æ—¶` | `curl -w '%{time_total}'` |

### 2.3 è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬


```bash
#!/bin/bash
# æœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬

check_service_health() {
    local service_name=$1
    local port=$2
    
    echo "=== æ£€æŸ¥æœåŠ¡: $service_name ==="
    
    # 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
    if systemctl is-active --quiet $service_name; then
        echo "âœ… æœåŠ¡çŠ¶æ€: è¿è¡Œä¸­"
    else
        echo "âŒ æœåŠ¡çŠ¶æ€: å¼‚å¸¸"
        return 1
    fi
    
    # 2. æ£€æŸ¥ç«¯å£ç›‘å¬
    if ss -tln | grep -q ":$port "; then
        echo "âœ… ç«¯å£ç›‘å¬: æ­£å¸¸"
    else
        echo "âŒ ç«¯å£ç›‘å¬: å¼‚å¸¸"
        return 1
    fi
    
    # 3. æ£€æŸ¥å“åº”æ—¶é—´
    response_time=$(curl -s -w '%{time_total}' -o /dev/null http://localhost:$port/)
    if (( $(echo "$response_time < 5.0" | bc -l) )); then
        echo "âœ… å“åº”æ—¶é—´: ${response_time}ç§’"
    else
        echo "âš ï¸ å“åº”æ—¶é—´: ${response_time}ç§’ (è¾ƒæ…¢)"
    fi
}

# æ£€æŸ¥å¸¸è§æœåŠ¡
check_service_health "nginx" "80"
check_service_health "mysql" "3306"
check_service_health "sshd" "22"
```

### 2.4 å‘Šè­¦é…ç½®


**ğŸš¨ å‘Šè­¦è§„åˆ™ç¤ºä¾‹**ï¼š
```bash
# /etc/monitoring/service-alert.conf
[nginx]
check_interval = 60    # æ£€æŸ¥é—´éš”60ç§’
max_failures = 3       # è¿ç»­å¤±è´¥3æ¬¡å‘Šè­¦
alert_email = admin@company.com
restart_on_failure = true

[mysql]  
check_interval = 30
max_failures = 2
alert_email = dba@company.com
restart_on_failure = false  # æ•°æ®åº“ä¸è‡ªåŠ¨é‡å¯
```

---

## 3. âš ï¸ å¼‚å¸¸è¡Œä¸ºæ£€æµ‹æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯å¼‚å¸¸è¡Œä¸ºæ£€æµ‹


**å½¢è±¡æ¯”å–»**ï¼šå°±åƒé“¶è¡Œçš„åæ¬ºè¯ˆç³»ç»Ÿï¼Œé€šè¿‡åˆ†æç”¨æˆ·çš„æ¶ˆè´¹ä¹ æƒ¯ï¼Œå‘ç°å¼‚å¸¸åˆ·å¡è¡Œä¸ºã€‚Linuxç³»ç»Ÿä¹Ÿéœ€è¦ç±»ä¼¼çš„æœºåˆ¶æ¥å‘ç°å¼‚å¸¸æ“ä½œã€‚

### 3.2 å¸¸è§å¼‚å¸¸è¡Œä¸ºç±»å‹


**ğŸ”¸ è¿›ç¨‹å¼‚å¸¸è¡Œä¸º**
```
æ­£å¸¸è¡Œä¸º                    å¼‚å¸¸è¡Œä¸º
WebæœåŠ¡å™¨å¯åŠ¨ â†’ æ­£å¸¸        çªç„¶å¯åŠ¨æŒ–çŸ¿ç¨‹åº â†’ å¼‚å¸¸
å®šæ—¶ä»»åŠ¡æ‰§è¡Œ â†’ æ­£å¸¸        åŠå¤œæ‰§è¡Œæ•æ„Ÿå‘½ä»¤ â†’ å¼‚å¸¸
ç”¨æˆ·ç™»å½•åŠå…¬ â†’ æ­£å¸¸        å‡Œæ™¨3ç‚¹ç™»å½• â†’ å¯ç–‘
```

### 3.3 æ£€æµ‹æœºåˆ¶å®ç°


**æ–¹æ³•1ï¼šåŸºäºè§„åˆ™çš„æ£€æµ‹**
```bash
# æ£€æµ‹å¯ç–‘è¿›ç¨‹å¯åŠ¨
#!/bin/bash

# å¯ç–‘è¿›ç¨‹åå•ï¼ˆé»‘åå•ï¼‰
SUSPICIOUS_PROCESSES=(
    "cryptonight"    # æŒ–çŸ¿ç¨‹åº
    "xmrig"         # é—¨ç½—å¸æŒ–çŸ¿
    "masscan"       # æ‰«æå·¥å…·
    "nmap"          # ç«¯å£æ‰«æ
    "sqlmap"        # SQLæ³¨å…¥å·¥å…·
)

check_suspicious_processes() {
    for process in "${SUSPICIOUS_PROCESSES[@]}"; do
        if pgrep -f "$process" > /dev/null; then
            echo "ğŸš¨ å‘ç°å¯ç–‘è¿›ç¨‹: $process"
            echo "PID: $(pgrep -f "$process")"
            echo "å‘½ä»¤è¡Œ: $(ps aux | grep "$process" | grep -v grep)"
            
            # è®°å½•åˆ°æ—¥å¿—
            logger "SECURITY ALERT: Suspicious process detected: $process"
        fi
    done
}
```

**æ–¹æ³•2ï¼šåŸºäºè¡Œä¸ºåŸºçº¿çš„æ£€æµ‹**
```bash
# CPUä½¿ç”¨ç‡å¼‚å¸¸æ£€æµ‹
#!/bin/bash

# å»ºç«‹CPUä½¿ç”¨åŸºçº¿ï¼ˆæ­£å¸¸æƒ…å†µä¸‹çš„å¹³å‡å€¼ï¼‰
NORMAL_CPU_USAGE=20  # æ­£å¸¸CPUä½¿ç”¨ç‡20%
ALERT_THRESHOLD=80   # å‘Šè­¦é˜ˆå€¼80%

check_cpu_anomaly() {
    current_cpu=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    
    if (( $(echo "$current_cpu > $ALERT_THRESHOLD" | bc -l) )); then
        echo "ğŸš¨ CPUä½¿ç”¨ç‡å¼‚å¸¸: ${current_cpu}%"
        
        # æ‰¾å‡ºCPUå ç”¨æœ€é«˜çš„è¿›ç¨‹
        echo "Top CPUæ¶ˆè€—è¿›ç¨‹:"
        ps aux --sort=-%cpu | head -5
        
        # æ£€æŸ¥æ˜¯å¦ä¸ºå·²çŸ¥è¿›ç¨‹
        top_process=$(ps aux --sort=-%cpu | head -2 | tail -1 | awk '{print $11}')
        echo "æœ€é«˜CPUè¿›ç¨‹: $top_process"
    fi
}
```

### 3.4 æœºå™¨å­¦ä¹ æ£€æµ‹


**åŸºæœ¬åŸç†**ï¼š
```
å†å²æ­£å¸¸æ•°æ® â†’ è®­ç»ƒæ¨¡å‹ â†’ å»ºç«‹æ­£å¸¸è¡Œä¸ºæ¨¡å¼ â†’ å®æ—¶æ£€æµ‹åå·®
```

**ç®€åŒ–å®ç°æ€è·¯**ï¼š
```bash
# ç”¨æˆ·ç™»å½•æ—¶é—´å¼‚å¸¸æ£€æµ‹
#!/bin/bash

# åˆ†æç”¨æˆ·æ­£å¸¸ç™»å½•æ—¶é—´æ¨¡å¼
analyze_login_pattern() {
    local username=$1
    
    # è·å–ç”¨æˆ·æœ€è¿‘30å¤©çš„ç™»å½•æ—¶é—´
    last -n 100 $username | grep -v "reboot" | \
    awk '{print $4}' | cut -d':' -f1 > /tmp/login_hours.txt
    
    # è®¡ç®—å¹³å‡ç™»å½•æ—¶é—´
    avg_hour=$(awk '{sum+=$1; n++} END {print sum/n}' /tmp/login_hours.txt)
    
    # å½“å‰ç™»å½•æ—¶é—´
    current_hour=$(date +%H)
    
    # å¦‚æœåå·®è¶…è¿‡6å°æ—¶ï¼Œè§†ä¸ºå¼‚å¸¸
    if (( $(echo "($current_hour - $avg_hour) > 6 || ($avg_hour - $current_hour) > 6" | bc -l) )); then
        echo "âš ï¸ ç”¨æˆ· $username å¼‚å¸¸æ—¶é—´ç™»å½•: ${current_hour}:00"
        echo "æ­£å¸¸ç™»å½•æ—¶é—´: ${avg_hour}:00 å·¦å³"
    fi
}
```

---

## 4. ğŸ“Š èµ„æºä½¿ç”¨å¼‚å¸¸å‘Šè­¦


### 4.1 èµ„æºç›‘æ§çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆè¦ç›‘æ§èµ„æºä½¿ç”¨ï¼Ÿ**
- **æ€§èƒ½é—®é¢˜** - èµ„æºä¸è¶³å¯¼è‡´ç³»ç»Ÿå˜æ…¢
- **å®‰å…¨å¨èƒ** - æ¶æ„ç¨‹åºå¤§é‡æ¶ˆè€—èµ„æº
- **å®¹é‡è§„åˆ’** - é¢„æµ‹ä½•æ—¶éœ€è¦æ‰©å®¹
- **æ•…éšœé¢„é˜²** - æå‰å‘ç°èµ„æºç“¶é¢ˆ

### 4.2 æ ¸å¿ƒèµ„æºç›‘æ§æŒ‡æ ‡


```
èµ„æºç›‘æ§å…¨æ™¯å›¾ï¼š

CPUç›‘æ§          å†…å­˜ç›‘æ§           ç£ç›˜ç›‘æ§           ç½‘ç»œç›‘æ§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ä½¿ç”¨ç‡   â”‚     â”‚ä½¿ç”¨ç‡   â”‚       â”‚ä½¿ç”¨ç‡   â”‚       â”‚å¸¦å®½ä½¿ç”¨ â”‚
â”‚è´Ÿè½½å‡è¡¡ â”‚     â”‚å¯ç”¨ç©ºé—´ â”‚       â”‚I/Oæ€§èƒ½  â”‚       â”‚è¿æ¥æ•°   â”‚
â”‚è¿›ç¨‹CPU  â”‚     â”‚äº¤æ¢åˆ†åŒº â”‚       â”‚ç£ç›˜å¥åº· â”‚       â”‚é”™è¯¯ç‡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 CPUèµ„æºç›‘æ§


**ğŸ”¸ CPUç›‘æ§æŒ‡æ ‡**
```bash
# ç»¼åˆCPUç›‘æ§è„šæœ¬
#!/bin/bash

monitor_cpu() {
    echo "=== CPUèµ„æºç›‘æ§ ==="
    
    # 1. CPUä½¿ç”¨ç‡
    cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    echo "CPUä½¿ç”¨ç‡: ${cpu_usage}%"
    
    # 2. ç³»ç»Ÿè´Ÿè½½
    load_avg=$(uptime | awk -F'load average:' '{print $2}')
    echo "ç³»ç»Ÿè´Ÿè½½: $load_avg"
    
    # 3. CPUå¯†é›†å‹è¿›ç¨‹
    echo "CPUå ç”¨Top5è¿›ç¨‹:"
    ps aux --sort=-%cpu | head -6 | tail -5
    
    # 4. å‘Šè­¦åˆ¤æ–­
    if (( $(echo "$cpu_usage > 80" | bc -l) )); then
        echo "ğŸš¨ CPUä½¿ç”¨ç‡è¿‡é«˜å‘Šè­¦!"
        
        # åˆ†æåŸå› 
        echo "å¯èƒ½åŸå› åˆ†æ:"
        high_cpu_process=$(ps aux --sort=-%cpu | head -2 | tail -1)
        echo "æœ€é«˜CPUè¿›ç¨‹: $high_cpu_process"
        
        # è‡ªåŠ¨å¤„ç†å»ºè®®
        echo "å»ºè®®æ“ä½œ:"
        echo "1. æ£€æŸ¥è¿›ç¨‹æ˜¯å¦æ­£å¸¸"
        echo "2. è€ƒè™‘é™åˆ¶è¿›ç¨‹CPUä½¿ç”¨ (nice/cpulimit)"
        echo "3. å¿…è¦æ—¶é‡å¯å¼‚å¸¸è¿›ç¨‹"
    fi
}
```

### 4.4 å†…å­˜èµ„æºç›‘æ§


**ğŸ”¸ å†…å­˜ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash

monitor_memory() {
    echo "=== å†…å­˜èµ„æºç›‘æ§ ==="
    
    # 1. å†…å­˜ä½¿ç”¨æƒ…å†µ
    free -h
    
    # 2. å†…å­˜ä½¿ç”¨ç‡è®¡ç®—
    total_mem=$(free | grep Mem | awk '{print $2}')
    used_mem=$(free | grep Mem | awk '{print $3}')
    mem_usage_percent=$((used_mem * 100 / total_mem))
    
    echo "å†…å­˜ä½¿ç”¨ç‡: ${mem_usage_percent}%"
    
    # 3. å†…å­˜å ç”¨Top5è¿›ç¨‹
    echo "å†…å­˜å ç”¨Top5è¿›ç¨‹:"
    ps aux --sort=-%mem | head -6 | tail -5
    
    # 4. äº¤æ¢åˆ†åŒºä½¿ç”¨æƒ…å†µ
    swap_usage=$(free | grep Swap | awk '{printf "%.1f", $3/$2 * 100}')
    echo "äº¤æ¢åˆ†åŒºä½¿ç”¨ç‡: ${swap_usage}%"
    
    # 5. å‘Šè­¦åˆ¤æ–­
    if [ $mem_usage_percent -gt 85 ]; then
        echo "ğŸš¨ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜å‘Šè­¦!"
        
        # å†…å­˜å ç”¨åˆ†æ
        echo "å†…å­˜å ç”¨åˆ†æ:"
        echo "ç¼“å­˜å ç”¨: $(free -h | grep Mem | awk '{print $6}')"
        echo "ç¼“å†²åŒºå ç”¨: $(free -h | grep Mem | awk '{print $5}')"
        
        # å»ºè®®æ“ä½œ
        echo "å»ºè®®æ“ä½œ:"
        echo "1. æ¸…ç†ç³»ç»Ÿç¼“å­˜: echo 3 > /proc/sys/vm/drop_caches"
        echo "2. æ£€æŸ¥å†…å­˜æ³„æ¼è¿›ç¨‹"
        echo "3. è€ƒè™‘å¢åŠ äº¤æ¢åˆ†åŒº"
    fi
}
```

### 4.5 ç£ç›˜èµ„æºç›‘æ§


**ğŸ”¸ ç£ç›˜ç›‘æ§è¦ç‚¹**
```bash
#!/bin/bash

monitor_disk() {
    echo "=== ç£ç›˜èµ„æºç›‘æ§ ==="
    
    # 1. ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
    echo "ç£ç›˜ç©ºé—´ä½¿ç”¨:"
    df -h | grep -v tmpfs
    
    # 2. æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡å‘Šè­¦
    df -h | grep -v tmpfs | awk 'NR>1 {
        usage = substr($5, 1, length($5)-1)
        if (usage > 80) {
            print "ğŸš¨ ç£ç›˜å‘Šè­¦: " $6 " ä½¿ç”¨ç‡ " $5
        }
    }'
    
    # 3. ç£ç›˜I/Oç›‘æ§
    echo "ç£ç›˜I/Oç»Ÿè®¡:"
    iostat -x 1 1 | grep -A 20 "Device"
    
    # 4. æŸ¥æ‰¾å¤§æ–‡ä»¶
    echo "æŸ¥æ‰¾å¤§äº100Mçš„æ–‡ä»¶:"
    find /var/log -type f -size +100M -exec ls -lh {} \; 2>/dev/null | head -5
    
    # 5. inodeä½¿ç”¨æƒ…å†µ
    echo "inodeä½¿ç”¨æƒ…å†µ:"
    df -i | awk 'NR>1 {
        inode_usage = substr($5, 1, length($5)-1)
        if (inode_usage > 80) {
            print "âš ï¸ inodeå‘Šè­¦: " $6 " inodeä½¿ç”¨ç‡ " $5
        }
    }'
}
```

### 4.6 ç»¼åˆèµ„æºå‘Šè­¦é…ç½®


**å‘Šè­¦é˜ˆå€¼é…ç½®æ–‡ä»¶**ï¼š
```bash
# /etc/monitoring/resource-thresholds.conf

# CPUå‘Šè­¦é˜ˆå€¼
CPU_WARNING_THRESHOLD=70
CPU_CRITICAL_THRESHOLD=85

# å†…å­˜å‘Šè­¦é˜ˆå€¼  
MEM_WARNING_THRESHOLD=75
MEM_CRITICAL_THRESHOLD=90

# ç£ç›˜å‘Šè­¦é˜ˆå€¼
DISK_WARNING_THRESHOLD=80
DISK_CRITICAL_THRESHOLD=95

# è´Ÿè½½å‘Šè­¦é˜ˆå€¼
LOAD_WARNING_THRESHOLD=5.0
LOAD_CRITICAL_THRESHOLD=10.0

# å‘Šè­¦é€šçŸ¥é…ç½®
ALERT_EMAIL="admin@company.com"
ALERT_INTERVAL=300  # 5åˆ†é’Ÿå†…ä¸é‡å¤å‘Šè­¦
```

---

## 5. ğŸ” æƒé™æå‡æ£€æµ‹


### 5.1 ä»€ä¹ˆæ˜¯æƒé™æå‡


**é€šä¿—è§£é‡Š**ï¼šå°±åƒå…¬å¸é‡Œçš„æ™®é€šå‘˜å·¥çªç„¶è·å¾—äº†CEOæƒé™ï¼Œè¿™ç§å¼‚å¸¸çš„æƒé™å˜åŒ–å¾€å¾€æ„å‘³ç€å®‰å…¨é£é™©ã€‚

**å¸¸è§æƒé™æå‡åœºæ™¯**ï¼š
```
æ­£å¸¸æƒé™æå‡               å¼‚å¸¸æƒé™æå‡
ç®¡ç†å‘˜ä½¿ç”¨sudo â†’ åˆç†      æ™®é€šç”¨æˆ·çªç„¶å˜root â†’ å¯ç–‘
å®šæ—¶ä»»åŠ¡åˆ‡æ¢ç”¨æˆ· â†’ åˆç†     Webè¿›ç¨‹è·å¾—rootæƒé™ â†’ å¼‚å¸¸
æœåŠ¡è´¦æˆ·æƒé™æ“ä½œ â†’ åˆç†     å¤–éƒ¨ç¨‹åºæå‡æƒé™ â†’ å±é™©
```

### 5.2 æƒé™æå‡æ£€æµ‹æ–¹æ³•


**ğŸ”¸ ç›‘æ§sudoä½¿ç”¨**
```bash
# ç›‘æ§sudoä½¿ç”¨æƒ…å†µ
#!/bin/bash

monitor_sudo_usage() {
    echo "=== sudoä½¿ç”¨ç›‘æ§ ==="
    
    # 1. æŸ¥çœ‹ä»Šæ—¥sudoä½¿ç”¨è®°å½•
    echo "ä»Šæ—¥sudoä½¿ç”¨ç»Ÿè®¡:"
    grep "$(date +%b\ %d)" /var/log/auth.log | grep sudo | \
    awk '{print $1" "$2" "$3" "$9" "$10}' | sort | uniq -c | sort -nr
    
    # 2. æ£€æŸ¥å¼‚å¸¸sudoä½¿ç”¨
    echo "æ£€æŸ¥å¼‚å¸¸sudoä½¿ç”¨:"
    
    # æ£€æŸ¥éå·¥ä½œæ—¶é—´sudoä½¿ç”¨ï¼ˆæ™š10ç‚¹åˆ°æ—©8ç‚¹ï¼‰
    current_hour=$(date +%H)
    if [ $current_hour -gt 22 ] || [ $current_hour -lt 8 ]; then
        recent_sudo=$(grep "$(date +%b\ %d)" /var/log/auth.log | \
                      grep sudo | tail -5)
        if [ ! -z "$recent_sudo" ]; then
            echo "âš ï¸ éå·¥ä½œæ—¶é—´sudoä½¿ç”¨:"
            echo "$recent_sudo"
        fi
    fi
    
    # 3. æ£€æŸ¥å¤±è´¥çš„sudoå°è¯•
    echo "å¤±è´¥çš„sudoå°è¯•:"
    grep "$(date +%b\ %d)" /var/log/auth.log | \
    grep "sudo.*incorrect password" | tail -5
}
```

**ğŸ”¸ ç›‘æ§è¿›ç¨‹æƒé™å˜åŒ–**
```bash
#!/bin/bash

monitor_process_privileges() {
    echo "=== è¿›ç¨‹æƒé™ç›‘æ§ ==="
    
    # 1. æŸ¥æ‰¾ä»¥rootæƒé™è¿è¡Œçš„éç³»ç»Ÿè¿›ç¨‹
    echo "ä»¥rootæƒé™è¿è¡Œçš„ç”¨æˆ·è¿›ç¨‹:"
    ps aux | awk '$1=="root" && $11!~/^\[/ {print $2, $11}' | \
    grep -E "(python|php|java|node|perl)" | head -10
    
    # 2. æ£€æŸ¥SUIDç¨‹åº
    echo "SUIDç¨‹åºæ£€æŸ¥:"
    find /usr/bin /bin /usr/local/bin -perm -4000 -type f 2>/dev/null | \
    while read file; do
        # æ£€æŸ¥æ˜¯å¦ä¸ºå¼‚å¸¸SUIDæ–‡ä»¶
        case $(basename $file) in
            "passwd"|"sudo"|"su"|"ping"|"mount") 
                # è¿™äº›æ˜¯æ­£å¸¸çš„SUIDç¨‹åº
                ;;
            *)
                echo "âš ï¸ å‘ç°å¯ç–‘SUIDç¨‹åº: $file"
                ls -la "$file"
                ;;
        esac
    done
    
    # 3. æ£€æŸ¥æœ€è¿‘ä¿®æ”¹çš„SUIDæ–‡ä»¶
    echo "æœ€è¿‘ä¿®æ”¹çš„SUIDæ–‡ä»¶:"
    find /usr -perm -4000 -mtime -7 -type f 2>/dev/null | head -5
}
```

### 5.3 æƒé™æå‡å‘Šè­¦


**å®æ—¶ç›‘æ§è„šæœ¬**ï¼š
```bash
#!/bin/bash

# æƒé™æå‡å®æ—¶å‘Šè­¦
setup_privilege_escalation_alert() {
    # ç›‘æ§/var/log/auth.logä¸­çš„æƒé™ç›¸å…³äº‹ä»¶
    tail -F /var/log/auth.log | while read line; do
        case "$line" in
            *"sudo: FAILED"*)
                echo "ğŸš¨ sudoå¤±è´¥å°è¯•: $line"
                ;;
            *"su: FAILED"*)
                echo "ğŸš¨ suå¤±è´¥å°è¯•: $line" 
                ;;
            *"sudo:"*"root"*)
                echo "â„¹ï¸ sudoä½¿ç”¨è®°å½•: $line"
                ;;
            *"USER_AUTH"*)
                echo "â„¹ï¸ ç”¨æˆ·è®¤è¯äº‹ä»¶: $line"
                ;;
        esac
    done
}
```

---

## 6. ğŸŒ ç½‘ç»œè¿æ¥å¼‚å¸¸ç›‘æ§


### 6.1 ç½‘ç»œç›‘æ§çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆç›‘æ§ç½‘ç»œè¿æ¥ï¼Ÿ**
- **å¤–éƒ¨æ”»å‡»æ£€æµ‹** - å‘ç°æ¶æ„è¿æ¥å°è¯•
- **æ•°æ®æ³„éœ²é˜²æŠ¤** - ç›‘æ§å¼‚å¸¸çš„æ•°æ®ä¼ è¾“
- **å†…éƒ¨å¨èƒè¯†åˆ«** - å‘ç°å†…éƒ¨çš„å¼‚å¸¸ç½‘ç»œè¡Œä¸º
- **æ€§èƒ½é—®é¢˜è¯Šæ–­** - è¯†åˆ«ç½‘ç»œç“¶é¢ˆ

### 6.2 ç½‘ç»œè¿æ¥ç›‘æ§æŒ‡æ ‡


**ğŸ”¸ è¿æ¥çŠ¶æ€ç›‘æ§**
```bash
#!/bin/bash

monitor_network_connections() {
    echo "=== ç½‘ç»œè¿æ¥ç›‘æ§ ==="
    
    # 1. å½“å‰è¿æ¥ç»Ÿè®¡
    echo "ç½‘ç»œè¿æ¥çŠ¶æ€ç»Ÿè®¡:"
    netstat -an | awk '/^tcp/ {print $6}' | sort | uniq -c | sort -nr
    
    # 2. ç›‘å¬ç«¯å£æ£€æŸ¥
    echo "å½“å‰ç›‘å¬ç«¯å£:"
    netstat -tlnp | grep LISTEN | awk '{print $4, $7}' | sort
    
    # 3. å¤–éƒ¨è¿æ¥åˆ†æ
    echo "å¤–éƒ¨è¿æ¥Top10:"
    netstat -an | grep ESTABLISHED | awk '{print $5}' | \
    cut -d: -f1 | sort | uniq -c | sort -nr | head -10
    
    # 4. æ£€æŸ¥å¼‚å¸¸ç«¯å£
    echo "æ£€æŸ¥å¼‚å¸¸ç›‘å¬ç«¯å£:"
    # å·²çŸ¥æ­£å¸¸ç«¯å£åˆ—è¡¨
    NORMAL_PORTS="22 80 443 25 53 110 143 993 995"
    
    netstat -tlnp | grep LISTEN | while read line; do
        port=$(echo $line | awk '{print $4}' | cut -d: -f2)
        if ! echo $NORMAL_PORTS | grep -q $port; then
            echo "âš ï¸ å¼‚å¸¸ç›‘å¬ç«¯å£: $port"
            echo "è¯¦æƒ…: $line"
        fi
    done
}
```

### 6.3 å¼‚å¸¸è¿æ¥æ£€æµ‹


**ğŸ”¸ å¯ç–‘è¿æ¥ç‰¹å¾**
```bash
#!/bin/bash

detect_suspicious_connections() {
    echo "=== å¯ç–‘è¿æ¥æ£€æµ‹ ==="
    
    # 1. æ£€æŸ¥å¤§é‡è¿æ¥çš„IP
    echo "è¿æ¥æ•°å¼‚å¸¸çš„IPåœ°å€:"
    netstat -an | grep ESTABLISHED | awk '{print $5}' | \
    cut -d: -f1 | sort | uniq -c | awk '$1 > 50 {print "ğŸš¨ IP " $2 " è¿æ¥æ•°: " $1}'
    
    # 2. æ£€æŸ¥å¼‚å¸¸æ—¶é—´çš„è¿æ¥
    current_hour=$(date +%H)
    if [ $current_hour -gt 22 ] || [ $current_hour -lt 6 ]; then
        established_count=$(netstat -an | grep ESTABLISHED | wc -l)
        if [ $established_count -gt 100 ]; then
            echo "âš ï¸ éå·¥ä½œæ—¶é—´è¿æ¥æ•°å¼‚å¸¸: $established_count"
        fi
    fi
    
    # 3. æ£€æŸ¥å¼‚å¸¸ç«¯å£è¿æ¥
    echo "å¼‚å¸¸ç«¯å£è¿æ¥æ£€æŸ¥:"
    netstat -an | grep ESTABLISHED | while read line; do
        remote_port=$(echo $line | awk '{print $5}' | cut -d: -f2)
        # æ£€æŸ¥è¿æ¥åˆ°å¯ç–‘ç«¯å£ï¼ˆå¦‚æŒ–çŸ¿ã€è¿œæ§å¸¸ç”¨ç«¯å£ï¼‰
        case $remote_port in
            4444|1337|31337|8080|9999)
                echo "ğŸš¨ è¿æ¥åˆ°å¯ç–‘ç«¯å£: $line"
                ;;
        esac
    done
    
    # 4. æ£€æŸ¥åå‘è¿æ¥
    echo "å¯èƒ½çš„åå‘è¿æ¥:"
    # æ£€æŸ¥ä»å†…éƒ¨ä¸»åŠ¨è¿æ¥åˆ°å¤–éƒ¨é«˜ç«¯å£çš„æƒ…å†µ
    netstat -an | grep ESTABLISHED | awk '{
        split($4, local, ":")
        split($5, remote, ":")
        if (remote[2] > 1024 && remote[2] < 65535 && local[2] < 1024) {
            print "âš ï¸ å¯èƒ½çš„åå‘è¿æ¥: " $0
        }
    }'
}
```

### 6.4 ç½‘ç»œæµé‡åˆ†æ


**ğŸ”¸ ç®€å•æµé‡ç›‘æ§**
```bash
#!/bin/bash

monitor_network_traffic() {
    echo "=== ç½‘ç»œæµé‡ç›‘æ§ ==="
    
    # 1. æ¥å£æµé‡ç»Ÿè®¡
    echo "ç½‘ç»œæ¥å£æµé‡:"
    cat /proc/net/dev | grep -E "(eth|ens|enp)" | \
    while read line; do
        interface=$(echo $line | cut -d: -f1 | tr -d ' ')
        rx_bytes=$(echo $line | awk '{print $2}')
        tx_bytes=$(echo $line | awk '{print $10}')
        
        # è½¬æ¢ä¸ºMB
        rx_mb=$((rx_bytes / 1024 / 1024))
        tx_mb=$((tx_bytes / 1024 / 1024))
        
        echo "$interface: æ¥æ”¶ ${rx_mb}MB, å‘é€ ${tx_mb}MB"
    done
    
    # 2. å®æ—¶æµé‡ç›‘æ§ï¼ˆç®€å•ç‰ˆï¼‰
    echo "å®æ—¶æµé‡ç›‘æ§ (æŒ‰Ctrl+Cåœæ­¢):"
    sar -n DEV 1 3 | grep -E "(eth|ens|enp)" | tail -3
}
```

---

## 7. ğŸ“ æ–‡ä»¶è®¿é—®è¡Œä¸ºå®¡è®¡


### 7.1 æ–‡ä»¶å®¡è®¡çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆè¦å®¡è®¡æ–‡ä»¶è®¿é—®ï¼Ÿ**
- **æ•°æ®ä¿æŠ¤** - ç›‘æ§æ•æ„Ÿæ–‡ä»¶çš„è®¿é—®
- **åˆè§„è¦æ±‚** - æ»¡è¶³å®¡è®¡å’Œåˆè§„æ ‡å‡†
- **å…¥ä¾µæ£€æµ‹** - å‘ç°æœªæˆæƒçš„æ–‡ä»¶è®¿é—®
- **é—®é¢˜è¿½è¸ª** - è¿½è¸ªæ–‡ä»¶ä¿®æ”¹çš„æ¥æº

### 7.2 Linuxæ–‡ä»¶å®¡è®¡å·¥å…·


**ğŸ”¸ auditdç³»ç»Ÿç®€ä»‹**

> **auditdæ˜¯ä»€ä¹ˆï¼Ÿ**
> 
> auditdæ˜¯Linuxå†…æ ¸çš„å®¡è®¡æ¡†æ¶ï¼Œå¯ä»¥è®°å½•ç³»ç»Ÿè°ƒç”¨ã€æ–‡ä»¶è®¿é—®ã€ç”¨æˆ·æ“ä½œç­‰å„ç§äº‹ä»¶ï¼Œå°±åƒç»™ç³»ç»Ÿå®‰è£…äº†"é»‘åŒ£å­"ã€‚

```bash
# å®‰è£…auditd (CentOS/RHEL)
yum install audit audit-libs

# å®‰è£…auditd (Ubuntu/Debian)  
apt-get install auditd audispd-plugins

# å¯åŠ¨å®¡è®¡æœåŠ¡
systemctl start auditd
systemctl enable auditd
```

### 7.3 æ–‡ä»¶è®¿é—®å®¡è®¡é…ç½®


**ğŸ”¸ åŸºæœ¬å®¡è®¡è§„åˆ™é…ç½®**
```bash
# ç¼–è¾‘å®¡è®¡è§„åˆ™æ–‡ä»¶
vim /etc/audit/rules.d/custom.rules

# ç›‘æ§é‡è¦ç³»ç»Ÿæ–‡ä»¶
-w /etc/passwd -p wa -k passwd_changes
-w /etc/shadow -p wa -k shadow_changes  
-w /etc/sudoers -p wa -k sudoers_changes
-w /etc/ssh/sshd_config -p wa -k sshd_config_changes

# ç›‘æ§æ•æ„Ÿç›®å½•
-w /var/log -p wa -k log_access
-w /home -p wa -k home_access
-w /root -p wa -k root_access

# ç›‘æ§æ‰§è¡Œæƒé™å˜åŒ–
-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -k perm_mod

# é‡å¯å®¡è®¡æœåŠ¡åº”ç”¨è§„åˆ™
systemctl restart auditd
```

**å‚æ•°è¯´æ˜**ï¼š
- `-w`ï¼šç›‘æ§è·¯å¾„
- `-p`ï¼šç›‘æ§æƒé™ï¼ˆr=è¯»ï¼Œw=å†™ï¼Œx=æ‰§è¡Œï¼Œa=å±æ€§ä¿®æ”¹ï¼‰
- `-k`ï¼šå…³é”®å­—æ ‡ç­¾ï¼Œä¾¿äºæ—¥å¿—æŸ¥è¯¢

### 7.4 å®¡è®¡æ—¥å¿—åˆ†æ


**ğŸ”¸ æŸ¥çœ‹å®¡è®¡æ—¥å¿—**
```bash
#!/bin/bash

analyze_file_audit_logs() {
    echo "=== æ–‡ä»¶è®¿é—®å®¡è®¡åˆ†æ ==="
    
    # 1. æŸ¥çœ‹passwdæ–‡ä»¶è®¿é—®è®°å½•
    echo "passwdæ–‡ä»¶è®¿é—®è®°å½•:"
    ausearch -k passwd_changes | tail -10
    
    # 2. æŸ¥çœ‹ä»Šæ—¥æ–‡ä»¶ä¿®æ”¹äº‹ä»¶
    echo "ä»Šæ—¥æ–‡ä»¶ä¿®æ”¹ç»Ÿè®¡:"
    ausearch -ts today -k perm_mod | grep -c "type=SYSCALL"
    
    # 3. æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„æ–‡ä»¶è®¿é—®
    echo "rootç”¨æˆ·æ–‡ä»¶è®¿é—® (æœ€è¿‘10æ¡):"
    ausearch -ui root -ts today | head -20
    
    # 4. æŸ¥çœ‹å¤±è´¥çš„æ–‡ä»¶è®¿é—®å°è¯•
    echo "å¤±è´¥çš„æ–‡ä»¶è®¿é—®å°è¯•:"
    ausearch -m AVC -ts today | head -10
    
    # 5. ç”Ÿæˆå®¡è®¡æŠ¥å‘Š
    echo "ç”Ÿæˆæ¯æ—¥å®¡è®¡æ‘˜è¦:"
    aureport -f --summary | head -20
}
```

**ğŸ”¸ å®æ—¶ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash

# å®æ—¶ç›‘æ§æ•æ„Ÿæ–‡ä»¶è®¿é—®
monitor_sensitive_files() {
    echo "å¼€å§‹å®æ—¶ç›‘æ§æ•æ„Ÿæ–‡ä»¶è®¿é—®..."
    
    # ä½¿ç”¨inotifyç›‘æ§æ–‡ä»¶å˜åŒ–
    inotifywait -m -r --format '%w%f %e %T' --timefmt '%Y-%m-%d %H:%M:%S' \
    /etc/passwd /etc/shadow /etc/sudoers /root/.ssh | \
    while read file event time; do
        case $event in
            MODIFY)
                echo "ğŸš¨ [$time] æ–‡ä»¶è¢«ä¿®æ”¹: $file"
                ;;
            OPEN)
                echo "â„¹ï¸ [$time] æ–‡ä»¶è¢«è®¿é—®: $file"
                ;;
            ATTRIB)  
                echo "âš ï¸ [$time] æ–‡ä»¶å±æ€§å˜åŒ–: $file"
                ;;
        esac
    done
}
```

### 7.5 è‡ªåŠ¨åŒ–æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥


**ğŸ”¸ æ–‡ä»¶å®Œæ•´æ€§ç›‘æ§**
```bash
#!/bin/bash

# é‡è¦æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
file_integrity_check() {
    IMPORTANT_FILES=(
        "/etc/passwd"
        "/etc/shadow" 
        "/etc/sudoers"
        "/etc/ssh/sshd_config"
        "/boot/grub/grub.cfg"
    )
    
    CHECKSUM_FILE="/var/lib/security/file_checksums.db"
    
    echo "=== æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥ ==="
    
    # é¦–æ¬¡è¿è¡Œåˆ›å»ºåŸºçº¿
    if [ ! -f "$CHECKSUM_FILE" ]; then
        echo "åˆ›å»ºæ–‡ä»¶å®Œæ•´æ€§åŸºçº¿..."
        mkdir -p $(dirname $CHECKSUM_FILE)
        for file in "${IMPORTANT_FILES[@]}"; do
            if [ -f "$file" ]; then
                sha256sum "$file" >> "$CHECKSUM_FILE"
            fi
        done
        echo "åŸºçº¿åˆ›å»ºå®Œæˆ!"
        return
    fi
    
    # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
    while read expected_hash file_path; do
        if [ -f "$file_path" ]; then
            current_hash=$(sha256sum "$file_path" | awk '{print $1}')
            if [ "$current_hash" != "$expected_hash" ]; then
                echo "ğŸš¨ æ–‡ä»¶å®Œæ•´æ€§å¼‚å¸¸: $file_path"
                echo "   æœŸæœ›å“ˆå¸Œ: $expected_hash"
                echo "   å½“å‰å“ˆå¸Œ: $current_hash"
                
                # è®°å½•å˜æ›´æ—¶é—´
                echo "   æœ€åä¿®æ”¹: $(stat -c %y "$file_path")"
            else
                echo "âœ… æ–‡ä»¶å®Œæ•´æ€§æ­£å¸¸: $file_path"
            fi
        else
            echo "âŒ æ–‡ä»¶ç¼ºå¤±: $file_path"
        fi
    done < "$CHECKSUM_FILE"
}
```

---

## 8. ğŸ“ˆ è¿›ç¨‹è¡Œä¸ºåŸºçº¿å»ºç«‹


### 8.1 ä»€ä¹ˆæ˜¯è¡Œä¸ºåŸºçº¿


**é€šä¿—è§£é‡Š**ï¼šå°±åƒåŒ»ç”Ÿéœ€è¦çŸ¥é“ç—…äººå¹³æ—¶çš„æ­£å¸¸ä½“æ¸©ã€è¡€å‹ä¸€æ ·ï¼Œç³»ç»Ÿç›‘æ§ä¹Ÿéœ€è¦çŸ¥é“"æ­£å¸¸æƒ…å†µ"æ˜¯ä»€ä¹ˆæ ·å­ï¼Œè¿™æ ·æ‰èƒ½è¯†åˆ«å¼‚å¸¸ã€‚

**åŸºçº¿åŒ…å«çš„å†…å®¹**ï¼š
```
è¿›ç¨‹åŸºçº¿                     ç½‘ç»œåŸºçº¿                     èµ„æºåŸºçº¿
â”œâ”€â”€ æ­£å¸¸è¿è¡Œçš„è¿›ç¨‹åˆ—è¡¨        â”œâ”€â”€ æ­£å¸¸çš„ç½‘ç»œè¿æ¥           â”œâ”€â”€ æ­£å¸¸çš„CPUä½¿ç”¨ç‡
â”œâ”€â”€ è¿›ç¨‹å¯åŠ¨æ—¶é—´æ¨¡å¼          â”œâ”€â”€ æ­£å¸¸çš„ç«¯å£ç›‘å¬           â”œâ”€â”€ æ­£å¸¸çš„å†…å­˜ä½¿ç”¨
â”œâ”€â”€ è¿›ç¨‹èµ„æºä½¿ç”¨æ¨¡å¼          â”œâ”€â”€ æ­£å¸¸çš„æµé‡æ¨¡å¼           â”œâ”€â”€ æ­£å¸¸çš„ç£ç›˜I/O
â””â”€â”€ è¿›ç¨‹é—´é€šä¿¡æ¨¡å¼           â””â”€â”€ æ­£å¸¸çš„è¿æ¥é¢‘ç‡           â””â”€â”€ æ­£å¸¸çš„ç½‘ç»œå¸¦å®½
```

### 8.2 è¿›ç¨‹åŸºçº¿å»ºç«‹æ–¹æ³•


**ğŸ”¸ è‡ªåŠ¨åŸºçº¿æ”¶é›†è„šæœ¬**
```bash
#!/bin/bash

BASELINE_DIR="/var/lib/security/baseline"
mkdir -p "$BASELINE_DIR"

collect_process_baseline() {
    local timestamp=$(date +%Y%m%d_%H%M%S)
    local baseline_file="$BASELINE_DIR/process_baseline_$timestamp.txt"
    
    echo "=== æ”¶é›†è¿›ç¨‹åŸºçº¿æ•°æ® ==="
    
    # 1. è¿è¡Œè¿›ç¨‹åˆ—è¡¨
    echo "# è¿è¡Œè¿›ç¨‹åˆ—è¡¨ - $(date)" > "$baseline_file"
    ps aux --sort=-%cpu | head -20 >> "$baseline_file"
    
    echo "" >> "$baseline_file"
    echo "# ç³»ç»ŸæœåŠ¡çŠ¶æ€" >> "$baseline_file"
    systemctl list-units --type=service --state=running >> "$baseline_file"
    
    # 2. ç½‘ç»œè¿æ¥çŠ¶æ€
    echo "" >> "$baseline_file"  
    echo "# ç½‘ç»œè¿æ¥åŸºçº¿" >> "$baseline_file"
    netstat -tlnp >> "$baseline_file"
    
    # 3. èµ„æºä½¿ç”¨åŸºçº¿
    echo "" >> "$baseline_file"
    echo "# èµ„æºä½¿ç”¨åŸºçº¿" >> "$baseline_file"
    echo "CPUè´Ÿè½½: $(uptime)" >> "$baseline_file"
    echo "å†…å­˜ä½¿ç”¨: $(free -h)" >> "$baseline_file"
    echo "ç£ç›˜ä½¿ç”¨: $(df -h)" >> "$baseline_file"
    
    echo "åŸºçº¿æ•°æ®å·²ä¿å­˜åˆ°: $baseline_file"
}

# å»ºç«‹7å¤©çš„åŸºçº¿æ•°æ®
create_weekly_baseline() {
    echo "å¼€å§‹å»ºç«‹7å¤©åŸºçº¿..."
    
    for day in {1..7}; do
        echo "æ”¶é›†ç¬¬${day}å¤©åŸºçº¿æ•°æ®..."
        collect_process_baseline
        
        # ç­‰å¾…24å°æ—¶ (å®é™…ä½¿ç”¨ä¸­é€šè¿‡crontabå®šæ—¶æ‰§è¡Œ)
        # sleep 86400
    done
    
    # åˆ†æåŸºçº¿æ•°æ®
    analyze_baseline_data
}
```

**ğŸ”¸ åŸºçº¿æ•°æ®åˆ†æ**
```bash
#!/bin/bash

analyze_baseline_data() {
    echo "=== åˆ†æåŸºçº¿æ•°æ® ==="
    
    BASELINE_DIR="/var/lib/security/baseline"
    ANALYSIS_FILE="$BASELINE_DIR/baseline_analysis.txt"
    
    # 1. åˆ†æå¸¸è§è¿›ç¨‹
    echo "# å¸¸è§è¿›ç¨‹åˆ†æ - $(date)" > "$ANALYSIS_FILE"
    echo "ç»Ÿè®¡7å¤©å†…å‡ºç°çš„è¿›ç¨‹é¢‘ç‡:" >> "$ANALYSIS_FILE"
    
    grep -h "^[^ ]*[ ]*[^ ]*[ ]*[^ ]*[ ]*[^ ]*[ ]*[^ ]*[ ]*[^ ]*[ ]*[^ ]*[ ]*[^ ]*[ ]*[^ ]*[ ]*[^ ]*[ ]*" \
    "$BASELINE_DIR"/process_baseline_*.txt | \
    awk '{print $11}' | sort | uniq -c | sort -nr | head -20 >> "$ANALYSIS_FILE"
    
    # 2. åˆ†æç½‘ç»œæœåŠ¡
    echo "" >> "$ANALYSIS_FILE"
    echo "# å¸¸è§ç½‘ç»œæœåŠ¡:" >> "$ANALYSIS_FILE"
    grep -h "LISTEN" "$BASELINE_DIR"/process_baseline_*.txt | \
    awk '{print $4}' | cut -d: -f2 | sort | uniq -c | sort -nr >> "$ANALYSIS_FILE"
    
    # 3. èµ„æºä½¿ç”¨æ¨¡å¼
    echo "" >> "$ANALYSIS_FILE" 
    echo "# èµ„æºä½¿ç”¨æ¨¡å¼åˆ†æ:" >> "$ANALYSIS_FILE"
    
    # CPUè´Ÿè½½å¹³å‡å€¼è®¡ç®—
    grep "load average" "$BASELINE_DIR"/process_baseline_*.txt | \
    awk -F'load average:' '{print $2}' | awk -F',' '{print $1}' | \
    awk '{sum+=$1; n++} END {print "å¹³å‡CPUè´Ÿè½½: " sum/n}' >> "$ANALYSIS_FILE"
    
    echo "åŸºçº¿åˆ†æå®Œæˆï¼Œç»“æœä¿å­˜åœ¨: $ANALYSIS_FILE"
}
```

### 8.3 åŸºçº¿æ¯”è¾ƒå’Œå¼‚å¸¸æ£€æµ‹


**ğŸ”¸ å®æ—¶å¼‚å¸¸æ£€æµ‹**
```bash
#!/bin/bash

detect_process_anomalies() {
    BASELINE_FILE="/var/lib/security/baseline/baseline_analysis.txt"
    
    if [ ! -f "$BASELINE_FILE" ]; then
        echo "âŒ åŸºçº¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆå»ºç«‹åŸºçº¿"
        return 1
    fi
    
    echo "=== è¿›ç¨‹å¼‚å¸¸æ£€æµ‹ ==="
    
    # 1. æ£€æµ‹æ–°å‡ºç°çš„è¿›ç¨‹
    echo "æ£€æµ‹æ–°è¿›ç¨‹..."
    current_processes=$(ps aux | awk 'NR>1 {print $11}' | sort | uniq)
    baseline_processes=$(grep -A 20 "å¸¸è§è¿›ç¨‹åˆ†æ" "$BASELINE_FILE" | \
                        awk 'NF==2 {print $2}' | grep -v "^#")
    
    echo "$current_processes" | while read process; do
        if ! echo "$baseline_processes" | grep -q "$process"; then
            echo "ğŸš¨ å‘ç°æ–°è¿›ç¨‹: $process"
            
            # è·å–è¿›ç¨‹è¯¦ç»†ä¿¡æ¯
            ps aux | grep "$process" | head -1
        fi
    done
    
    # 2. æ£€æµ‹å¼‚å¸¸èµ„æºä½¿ç”¨
    echo "æ£€æµ‹èµ„æºä½¿ç”¨å¼‚å¸¸..."
    current_load=$(uptime | awk -F'load average:' '{print $2}' | awk -F',' '{print $1}' | tr -d ' ')
    baseline_load=$(grep "å¹³å‡CPUè´Ÿè½½" "$BASELINE_FILE" | awk '{print $3}')
    
    if (( $(echo "$current_load > $baseline_load * 2" | bc -l) )); then
        echo "ğŸš¨ CPUè´Ÿè½½å¼‚å¸¸: å½“å‰ $current_load, åŸºçº¿ $baseline_load"
    fi
    
    # 3. æ£€æµ‹å¼‚å¸¸ç½‘ç»œè¿æ¥
    echo "æ£€æµ‹ç½‘ç»œå¼‚å¸¸..."
    current_connections=$(netstat -an | grep ESTABLISHED | wc -l)
    
    # ç®€å•çš„è¿æ¥æ•°å¼‚å¸¸æ£€æµ‹
    if [ $current_connections -gt 200 ]; then
        echo "ğŸš¨ ç½‘ç»œè¿æ¥æ•°å¼‚å¸¸: $current_connections"
        echo "Topè¿æ¥IP:"
        netstat -an | grep ESTABLISHED | awk '{print $5}' | \
        cut -d: -f1 | sort | uniq -c | sort -nr | head -5
    fi
}
```

### 8.4 åŸºçº¿è‡ªåŠ¨æ›´æ–°


**ğŸ”¸ åŠ¨æ€åŸºçº¿è°ƒæ•´**
```bash
#!/bin/bash

update_baseline() {
    echo "=== åŸºçº¿è‡ªåŠ¨æ›´æ–° ==="
    
    BASELINE_DIR="/var/lib/security/baseline"
    
    # 1. æ£€æŸ¥åŸºçº¿å¹´é¾„
    baseline_age=$(find "$BASELINE_DIR" -name "baseline_analysis.txt" -mtime +7)
    
    if [ ! -z "$baseline_age" ]; then
        echo "åŸºçº¿æ•°æ®è¿‡æ—§ï¼Œå¼€å§‹æ›´æ–°..."
        
        # å¤‡ä»½æ—§åŸºçº¿
        cp "$BASELINE_DIR/baseline_analysis.txt" \
           "$BASELINE_DIR/baseline_analysis_backup_$(date +%Y%m%d).txt"
        
        # é‡æ–°æ”¶é›†åŸºçº¿
        collect_process_baseline
        analyze_baseline_data
        
        echo "åŸºçº¿æ›´æ–°å®Œæˆ"
    else
        echo "åŸºçº¿æ•°æ®è¾ƒæ–°ï¼Œæ— éœ€æ›´æ–°"
    fi
    
    # 2. æ¸…ç†è¿‡æœŸçš„åŸºçº¿æ–‡ä»¶
    find "$BASELINE_DIR" -name "process_baseline_*.txt" -mtime +30 -delete
    echo "æ¸…ç†å®Œæˆè¿‡æœŸåŸºçº¿æ–‡ä»¶"
}
```

---

## 9. ğŸš¨ å®‰å…¨äº‹ä»¶å“åº”æµç¨‹


### 9.1 äº‹ä»¶å“åº”æµç¨‹æ¦‚è¿°


**äº‹ä»¶å“åº”çš„é‡è¦æ€§**ï¼š
> å‘ç°å®‰å…¨äº‹ä»¶åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œå¦‚ä½•å¿«é€Ÿã€æœ‰æ•ˆåœ°å¤„ç†äº‹ä»¶æ‰æ˜¯å…³é”®ã€‚å°±åƒç«ç¾å‘ç”Ÿåï¼Œä¸ä»…è¦æŠ¥è­¦ï¼Œè¿˜è¦çŸ¥é“å¦‚ä½•ç­ç«ã€ç–æ•£ã€å‡å°‘æŸå¤±ã€‚

### 9.2 å“åº”æµç¨‹æ¡†æ¶


```
å®‰å…¨äº‹ä»¶å“åº”æµç¨‹ï¼š

æ£€æµ‹é˜¶æ®µ          åˆ†æé˜¶æ®µ          å“åº”é˜¶æ®µ          æ¢å¤é˜¶æ®µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å‘Šè­¦è§¦å‘ â”‚ â”€â”€â†’ â”‚äº‹ä»¶åˆ†æ â”‚ â”€â”€â†’  â”‚ç«‹å³å“åº” â”‚ â”€â”€â†’  â”‚ç³»ç»Ÿæ¢å¤ â”‚
â”‚æ—¥å¿—åˆ†æ â”‚     â”‚å½±å“è¯„ä¼° â”‚      â”‚å¨èƒéš”ç¦» â”‚      â”‚æ¼æ´ä¿®å¤ â”‚
â”‚è¡Œä¸ºæ£€æµ‹ â”‚     â”‚æ ¹å› åˆ†æ â”‚      â”‚è¯æ®ä¿å…¨ â”‚      â”‚ç›‘æ§åŠ å¼º â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚                â”‚               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚äº‹ä»¶è®°å½• â”‚      â”‚ç»éªŒæ€»ç»“ â”‚
                 â”‚é€šçŸ¥ç›¸å…³ â”‚      â”‚æµç¨‹æ”¹è¿› â”‚
                 â”‚äººå‘˜    â”‚      â”‚é˜²æŠ¤åŠ å¼º â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 äº‹ä»¶åˆ†ç±»å’Œä¼˜å…ˆçº§


**ğŸ”¸ äº‹ä»¶ä¸¥é‡æ€§åˆ†çº§**

| çº§åˆ« | **å½±å“ç¨‹åº¦** | **å“åº”æ—¶é—´** | **å…¸å‹äº‹ä»¶** |
|------|------------|------------|------------|
| ğŸ”´ **ç´§æ€¥** | `ç³»ç»Ÿå®Œå…¨ç˜«ç—ª` | `15åˆ†é’Ÿå†…` | `rootæƒé™è¢«è·å–ã€ç³»ç»Ÿè¢«åŠ å¯†` |
| ğŸŸ  **é«˜** | `æ ¸å¿ƒä¸šåŠ¡å—å½±å“` | `1å°æ—¶å†…` | `é‡è¦æœåŠ¡å¼‚å¸¸ã€æ•°æ®æ³„éœ²` |
| ğŸŸ¡ **ä¸­** | `éƒ¨åˆ†åŠŸèƒ½å—é™` | `4å°æ—¶å†…` | `å•ä¸ªæœåŠ¡æ•…éšœã€å¯ç–‘è¡Œä¸º` |
| ğŸŸ¢ **ä½** | `æ— æ˜æ˜¾å½±å“` | `24å°æ—¶å†…` | `æ—¥å¿—å¼‚å¸¸ã€æ€§èƒ½é—®é¢˜` |

### 9.4 è‡ªåŠ¨å“åº”è„šæœ¬


**ğŸ”¸ äº‹ä»¶æ£€æµ‹å’Œè‡ªåŠ¨å“åº”**
```bash
#!/bin/bash

# å®‰å…¨äº‹ä»¶è‡ªåŠ¨å“åº”ç³»ç»Ÿ
RESPONSE_LOG="/var/log/security_response.log"
ALERT_EMAIL="admin@company.com"

log_event() {
    local level=$1
    local message=$2
    echo "[$(date)] [$level] $message" >> "$RESPONSE_LOG"
    echo "[$(date)] [$level] $message"
}

send_alert() {
    local subject=$1
    local body=$2
    echo "$body" | mail -s "$subject" "$ALERT_EMAIL"
}

# ç´§æ€¥å“åº”å¤„ç†
emergency_response() {
    local threat_type=$1
    
    log_event "EMERGENCY" "è§¦å‘ç´§æ€¥å“åº”: $threat_type"
    
    case $threat_type in
        "root_compromise")
            log_event "EMERGENCY" "æ£€æµ‹åˆ°rootæƒé™è¢«è·å–ï¼Œæ‰§è¡Œç´§æ€¥éš”ç¦»"
            
            # 1. ç«‹å³æ–­å¼€ç½‘ç»œè¿æ¥
            log_event "ACTION" "æ–­å¼€ç½‘ç»œè¿æ¥"
            # iptables -A INPUT -j DROP
            # iptables -A OUTPUT -j DROP
            
            # 2. ç»ˆæ­¢å¯ç–‘è¿›ç¨‹
            log_event "ACTION" "ç»ˆæ­¢å¯ç–‘è¿›ç¨‹"
            # pkill -f suspicious_process
            
            # 3. é”å®šç”¨æˆ·è´¦æˆ·
            log_event "ACTION" "é”å®šå¯ç–‘ç”¨æˆ·è´¦æˆ·"
            # passwd -l suspicious_user
            
            # 4. å‘é€ç´§æ€¥é€šçŸ¥
            send_alert "EMERGENCY: Rootæƒé™è¢«è·å–" \
                      "æ£€æµ‹åˆ°rootæƒé™è¢«éæ³•è·å–ï¼Œç³»ç»Ÿå·²è¿›å…¥ç´§æ€¥éš”ç¦»æ¨¡å¼"
            ;;
            
        "massive_file_deletion")
            log_event "EMERGENCY" "æ£€æµ‹åˆ°å¤§é‡æ–‡ä»¶è¢«åˆ é™¤"
            
            # 1. åœæ­¢å¯ç–‘è¿›ç¨‹
            suspicious_pids=$(ps aux | grep -E "(rm|shred|wipe)" | grep -v grep | awk '{print $2}')
            for pid in $suspicious_pids; do
                log_event "ACTION" "ç»ˆæ­¢å¯ç–‘åˆ é™¤è¿›ç¨‹: $pid"
                kill -STOP $pid
            done
            
            # 2. å¯åŠ¨æ–‡ä»¶ç³»ç»Ÿä¿æŠ¤
            mount -o remount,ro /home
            log_event "ACTION" "å°†/homeæŒ‚è½½ä¸ºåªè¯»æ¨¡å¼"
            ;;
    esac
}

# é«˜ä¼˜å…ˆçº§å“åº”
high_priority_response() {
    local event_type=$1
    
    log_event "HIGH" "å¤„ç†é«˜ä¼˜å…ˆçº§äº‹ä»¶: $event_type"
    
    case $event_type in
        "bruteforce_attack")
            # SSHæš´åŠ›ç ´è§£å“åº”
            log_event "ACTION" "æ£€æµ‹åˆ°SSHæš´åŠ›ç ´è§£ï¼ŒåŠ å¼ºé˜²æŠ¤"
            
            # ä¸´æ—¶å°ç¦æ”»å‡»IP
            attacking_ips=$(grep "Failed password" /var/log/auth.log | \
                           tail -100 | awk '{print $(NF-3)}' | sort | uniq -c | \
                           awk '$1>10{print $2}')
            
            for ip in $attacking_ips; do
                iptables -A INPUT -s $ip -j DROP
                log_event "ACTION" "å°ç¦æ”»å‡»IP: $ip"
            done
            ;;
            
        "suspicious_process")
            # å¯ç–‘è¿›ç¨‹å“åº”
            log_event "ACTION" "æ£€æµ‹åˆ°å¯ç–‘è¿›ç¨‹"
            
            # è®°å½•è¿›ç¨‹ä¿¡æ¯
            ps aux > "/tmp/process_snapshot_$(date +%Y%m%d_%H%M%S).txt"
            log_event "ACTION" "å·²ä¿å­˜è¿›ç¨‹å¿«ç…§"
            ;;
    esac
}
```

### 9.5 è¯æ®ä¿å…¨


**ğŸ”¸ æ•°å­—å–è¯å‡†å¤‡**
```bash
#!/bin/bash

preserve_evidence() {
    local incident_id=$1
    local evidence_dir="/var/forensics/incident_$incident_id"
    
    mkdir -p "$evidence_dir"
    log_event "FORENSICS" "å¼€å§‹è¯æ®ä¿å…¨: $incident_id"
    
    # 1. ç³»ç»ŸçŠ¶æ€å¿«ç…§
    echo "=== ç³»ç»ŸçŠ¶æ€å¿«ç…§ ===" > "$evidence_dir/system_state.txt"
    date >> "$evidence_dir/system_state.txt"
    uptime >> "$evidence_dir/system_state.txt"
    ps aux >> "$evidence_dir/system_state.txt"
    netstat -an >> "$evidence_dir/system_state.txt"
    
    # 2. ä¿å­˜å…³é”®æ—¥å¿—
    cp /var/log/auth.log* "$evidence_dir/"
    cp /var/log/syslog* "$evidence_dir/"
    cp /var/log/secure* "$evidence_dir/" 2>/dev/null
    
    # 3. ä¿å­˜ç½‘ç»œè¿æ¥ä¿¡æ¯
    ss -tuln > "$evidence_dir/network_connections.txt"
    iptables -L -n > "$evidence_dir/firewall_rules.txt"
    
    # 4. ä¿å­˜è¿›ç¨‹å†…å­˜ä¿¡æ¯ï¼ˆä»…å…³é”®è¿›ç¨‹ï¼‰
    for pid in $(pgrep -f "suspicious|malware"); do
        if [ -d "/proc/$pid" ]; then
            cp "/proc/$pid/cmdline" "$evidence_dir/process_${pid}_cmdline.txt" 2>/dev/null
            cp "/proc/$pid/environ" "$evidence_dir/process_${pid}_environ.txt" 2>/dev/null
        fi
    done
    
    # 5. è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
    find "$evidence_dir" -type f -exec sha256sum {} \; > "$evidence_dir/checksums.txt"
    
    log_event "FORENSICS" "è¯æ®ä¿å…¨å®Œæˆ: $evidence_dir"
}
```

### 9.6 äº‹ä»¶é€šçŸ¥æœºåˆ¶


**ğŸ”¸ å¤šæ¸ é“é€šçŸ¥ç³»ç»Ÿ**
```bash
#!/bin/bash

notify_security_event() {
    local event_level=$1
    local event_type=$2  
    local event_details=$3
    
    # æ ¹æ®äº‹ä»¶çº§åˆ«é€‰æ‹©é€šçŸ¥æ–¹å¼
    case $event_level in
        "EMERGENCY")
            # ç´§æ€¥äº‹ä»¶ï¼šé‚®ä»¶+çŸ­ä¿¡+ç”µè¯
            send_email_alert "$event_type" "$event_details"
            # send_sms_alert "$event_type" 
            log_event "NOTIFICATION" "å·²å‘é€ç´§æ€¥é€šçŸ¥"
            ;;
            
        "HIGH")
            # é«˜çº§äº‹ä»¶ï¼šé‚®ä»¶+å³æ—¶æ¶ˆæ¯
            send_email_alert "$event_type" "$event_details"
            # send_slack_alert "$event_type" "$event_details"
            log_event "NOTIFICATION" "å·²å‘é€é«˜ä¼˜å…ˆçº§é€šçŸ¥"
            ;;
            
        "MEDIUM"|"LOW")
            # ä¸­ä½çº§äº‹ä»¶ï¼šä»…é‚®ä»¶
            send_email_alert "$event_type" "$event_details"
            log_event "NOTIFICATION" "å·²å‘é€æ ‡å‡†é€šçŸ¥"
            ;;
    esac
}

send_email_alert() {
    local subject=$1
    local body=$2
    
    cat <<EOF | mail -s "å®‰å…¨å‘Šè­¦: $subject" "$ALERT_EMAIL"
å®‰å…¨äº‹ä»¶è¯¦æƒ…:
æ—¶é—´: $(date)
ç±»å‹: $subject
æè¿°: $body

ç³»ç»Ÿä¿¡æ¯:
ä¸»æœºå: $(hostname)
IPåœ°å€: $(hostname -I)
è´Ÿè½½: $(uptime)

è¯·ç«‹å³æ£€æŸ¥å¹¶å¤„ç†ã€‚
EOF
}
```

### 9.7 æ¢å¤å’Œæ”¹è¿›


**ğŸ”¸ äº‹ä»¶åç»­å¤„ç†**
```bash
#!/bin/bash

post_incident_activities() {
    local incident_id=$1
    
    log_event "RECOVERY" "å¼€å§‹äº‹ä»¶åç»­å¤„ç†: $incident_id"
    
    # 1. ç³»ç»Ÿå®‰å…¨æ£€æŸ¥
    echo "æ‰§è¡Œå…¨é¢å®‰å…¨æ£€æŸ¥..."
    
    # æ£€æŸ¥ç³»ç»Ÿæ–‡ä»¶å®Œæ•´æ€§
    if command -v aide >/dev/null 2>&1; then
        aide --check > "/tmp/aide_check_$incident_id.txt"
        log_event "RECOVERY" "å·²æ‰§è¡Œæ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥"
    fi
    
    # æ£€æŸ¥ç”¨æˆ·è´¦æˆ·å®‰å…¨
    awk -F: '$3==0{print $1}' /etc/passwd > "/tmp/root_users_$incident_id.txt"
    log_event "RECOVERY" "å·²æ£€æŸ¥ç‰¹æƒç”¨æˆ·è´¦æˆ·"
    
    # 2. æ›´æ–°å®‰å…¨ç­–ç•¥
    echo "æ›´æ–°å®‰å…¨ç­–ç•¥..."
    
    # åŠ å¼ºå¯†ç ç­–ç•¥
    # sed -i 's/PASS_MIN_LEN.*/PASS_MIN_LEN 12/' /etc/login.defs
    
    # æ›´æ–°é˜²ç«å¢™è§„åˆ™
    # æ ¹æ®äº‹ä»¶ç±»å‹æ·»åŠ ç›¸åº”çš„é˜²æŠ¤è§„åˆ™
    
    # 3. ç”Ÿæˆäº‹ä»¶æŠ¥å‘Š
    generate_incident_report "$incident_id"
    
    log_event "RECOVERY" "äº‹ä»¶åç»­å¤„ç†å®Œæˆ"
}

generate_incident_report() {
    local incident_id=$1
    local report_file="/var/reports/incident_${incident_id}_report.txt"
    
    cat > "$report_file" <<EOF
å®‰å…¨äº‹ä»¶æŠ¥å‘Š
=================
äº‹ä»¶ID: $incident_id
æŠ¥å‘Šæ—¶é—´: $(date)

äº‹ä»¶æ‘˜è¦:
$(grep "$incident_id" "$RESPONSE_LOG" | head -10)

å“åº”æªæ–½:
$(grep "ACTION" "$RESPONSE_LOG" | grep "$incident_id")

å½±å“è¯„ä¼°:
- å—å½±å“ç³»ç»Ÿ: $(hostname)
- ä¸šåŠ¡å½±å“: å¾…è¯„ä¼°
- æ•°æ®å½±å“: å¾…è¯„ä¼°

æ”¹è¿›å»ºè®®:
1. åŠ å¼ºç›‘æ§è¦†ç›–èŒƒå›´
2. ä¼˜åŒ–å“åº”æµç¨‹
3. æ›´æ–°å®‰å…¨åŸ¹è®­

åç»­è¡ŒåŠ¨:
â–¡ æ¼æ´ä¿®å¤
â–¡ ç›‘æ§åŠ å¼º  
â–¡ ç­–ç•¥æ›´æ–°
â–¡ åŸ¹è®­å¼€å±•
EOF

    log_event "REPORT" "äº‹ä»¶æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¿è¡Œæ—¶ç›‘æ§ï¼šç³»ç»Ÿè¿è¡ŒæœŸé—´çš„å®æ—¶å®‰å…¨ç›‘æ§ï¼Œåƒç»™ç³»ç»Ÿè£…ä¸Š"ç›‘æ§æ‘„åƒå¤´"
ğŸ”¸ æœåŠ¡ç›‘æ§ï¼šæ£€æŸ¥å„ç§ç³»ç»ŸæœåŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œç¡®ä¿æœåŠ¡æ­£å¸¸å·¥ä½œ
ğŸ”¸ å¼‚å¸¸æ£€æµ‹ï¼šé€šè¿‡å¯¹æ¯”æ­£å¸¸è¡Œä¸ºåŸºçº¿ï¼Œå‘ç°å¯ç–‘çš„å¼‚å¸¸æ´»åŠ¨
ğŸ”¸ æƒé™ç›‘æ§ï¼šç›‘æ§ç”¨æˆ·æƒé™å˜åŒ–ï¼Œé˜²æ­¢æœªæˆæƒçš„æƒé™æå‡
ğŸ”¸ äº‹ä»¶å“åº”ï¼šå‘ç°å®‰å…¨äº‹ä»¶åçš„å¤„ç†æµç¨‹ï¼ŒåŒ…æ‹¬éš”ç¦»ã€è°ƒæŸ¥ã€æ¢å¤
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§çš„æ ¸å¿ƒæ€è·¯**
```
å»ºç«‹åŸºçº¿ â†’ å®æ—¶ç›‘æ§ â†’ å¼‚å¸¸æ£€æµ‹ â†’ è‡ªåŠ¨å“åº” â†’ äººå·¥å¤„ç†

å°±åƒåŒ»ç”Ÿçœ‹ç—…ï¼š
1. å…ˆäº†è§£ç—…äººæ­£å¸¸çŠ¶æ€ï¼ˆåŸºçº¿ï¼‰
2. å®šæœŸæ£€æŸ¥èº«ä½“æŒ‡æ ‡ï¼ˆç›‘æ§ï¼‰  
3. å‘ç°å¼‚å¸¸æ•°æ®ï¼ˆæ£€æµ‹ï¼‰
4. ç«‹å³å¤„ç†ç´§æ€¥æƒ…å†µï¼ˆå“åº”ï¼‰
5. åˆ¶å®šæ²»ç–—æ–¹æ¡ˆï¼ˆäººå·¥å¤„ç†ï¼‰
```

**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦å¤šå±‚ç›‘æ§**
```
è¿›ç¨‹å±‚é¢ï¼šç›‘æ§ç¨‹åºè¡Œä¸º
ç½‘ç»œå±‚é¢ï¼šç›‘æ§ç½‘ç»œè¿æ¥  
æ–‡ä»¶å±‚é¢ï¼šç›‘æ§æ–‡ä»¶è®¿é—®
ç³»ç»Ÿå±‚é¢ï¼šç›‘æ§èµ„æºä½¿ç”¨

å•ä¸€ç›‘æ§å®¹æ˜“è¢«ç»•è¿‡ï¼Œå¤šå±‚ç›‘æ§å½¢æˆç«‹ä½“é˜²æŠ¤ç½‘
```

**ğŸ”¹ å“åº”é€Ÿåº¦çš„é‡è¦æ€§**
```
å‘ç°æ—¶é—´ï¼šè¶Šæ—©å‘ç°ï¼ŒæŸå¤±è¶Šå°
å“åº”æ—¶é—´ï¼šè¶Šå¿«å“åº”ï¼Œæ§åˆ¶è¶Šå¥½
æ¢å¤æ—¶é—´ï¼šè¶Šå¿«æ¢å¤ï¼Œå½±å“è¶Šå°

å®‰å…¨ç›‘æ§çš„ä»·å€¼ = å¨èƒå‘ç°èƒ½åŠ› Ã— å“åº”å¤„ç†é€Ÿåº¦
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ç›‘æ§éƒ¨ç½²å»ºè®®**
```
å°å‹ç¯å¢ƒï¼ˆ< 10å°æœåŠ¡å™¨ï¼‰ï¼š
âœ… é‡ç‚¹ç›‘æ§ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€å…³é”®è¿›ç¨‹
âœ… å·¥å…·é€‰æ‹©ï¼šç³»ç»Ÿè‡ªå¸¦å·¥å…· + ç®€å•è„šæœ¬
âœ… å‘Šè­¦æ–¹å¼ï¼šé‚®ä»¶å‘Šè­¦

ä¸­å‹ç¯å¢ƒï¼ˆ10-100å°æœåŠ¡å™¨ï¼‰ï¼š
âœ… é‡ç‚¹ç›‘æ§ï¼šå¢åŠ ç½‘ç»œç›‘æ§ã€æ—¥å¿—åˆ†æ
âœ… å·¥å…·é€‰æ‹©ï¼šå¼€æºç›‘æ§ç³»ç»Ÿï¼ˆå¦‚Nagiosã€Zabbixï¼‰
âœ… å‘Šè­¦æ–¹å¼ï¼šé‚®ä»¶ + çŸ­ä¿¡

å¤§å‹ç¯å¢ƒï¼ˆ> 100å°æœåŠ¡å™¨ï¼‰ï¼š
âœ… é‡ç‚¹ç›‘æ§ï¼šå…¨æ–¹ä½ç›‘æ§ + è¡Œä¸ºåˆ†æ
âœ… å·¥å…·é€‰æ‹©ï¼šä¼ä¸šçº§ç›‘æ§å¹³å°
âœ… å‘Šè­¦æ–¹å¼ï¼šå¤šæ¸ é“ + è‡ªåŠ¨å“åº”
```

**ğŸ”§ å¸¸ç”¨ç›‘æ§å‘½ä»¤é€ŸæŸ¥**
```bash
# ç³»ç»Ÿèµ„æºç›‘æ§
top                    # å®æ—¶è¿›ç¨‹å’Œèµ„æºç›‘æ§
htop                   # å¢å¼ºç‰ˆtop
iotop                  # ç£ç›˜I/Oç›‘æ§
iftop                  # ç½‘ç»œæµé‡ç›‘æ§

# è¿›ç¨‹ç›‘æ§
ps aux                 # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pgrep process_name     # æŒ‰åç§°æŸ¥æ‰¾è¿›ç¨‹
pidof process_name     # è·å–è¿›ç¨‹PID
lsof -p PID           # æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶

# ç½‘ç»œç›‘æ§
netstat -tlnp         # æŸ¥çœ‹ç›‘å¬ç«¯å£
ss -tlnp              # ç°ä»£ç‰ˆnetstat
lsof -i :port         # æŸ¥çœ‹ç«¯å£ä½¿ç”¨æƒ…å†µ
tcpdump -i eth0       # ç½‘ç»œæŠ“åŒ…

# æ–‡ä»¶ç›‘æ§
inotifywait -m /path  # å®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ–
auditctl -l           # æŸ¥çœ‹å®¡è®¡è§„åˆ™
ausearch -k keyword   # æœç´¢å®¡è®¡æ—¥å¿—

# ç³»ç»ŸçŠ¶æ€
systemctl status      # æœåŠ¡çŠ¶æ€
journalctl -f         # å®æ—¶æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
dmesg                 # å†…æ ¸æ¶ˆæ¯
uptime                # ç³»ç»Ÿè´Ÿè½½å’Œè¿è¡Œæ—¶é—´
```

**âš ï¸ ç›‘æ§æ³¨æ„äº‹é¡¹**
- **é¿å…è¿‡åº¦ç›‘æ§** - ç›‘æ§æœ¬èº«ä¹Ÿæ¶ˆè€—èµ„æº
- **åˆç†è®¾ç½®é˜ˆå€¼** - é¿å…è¯¯æŠ¥å’Œæ¼æŠ¥
- **å®šæœŸæ›´æ–°åŸºçº¿** - åŸºçº¿è¿‡æ—§ä¼šå¯¼è‡´è¯¯åˆ¤
- **ä¿æŠ¤ç›‘æ§æ•°æ®** - é˜²æ­¢ç›‘æ§ç³»ç»Ÿè¢«æ”»å‡»

**ğŸ“š æ‰©å±•å­¦ä¹ èµ„æº**
- `man auditd` - å®¡è®¡ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£
- `man systemctl` - æœåŠ¡ç®¡ç†å‘½ä»¤
- Linuxå®‰å…¨åŠ å›ºæŒ‡å—
- NISTç½‘ç»œå®‰å…¨æ¡†æ¶

### 10.4 å­¦ä¹ æ£€æŸ¥æ¸…å•


**åŸºç¡€æŒæ¡ âœ“**
- [ ] ç†è§£è¿è¡Œæ—¶ç›‘æ§çš„åŸºæœ¬æ¦‚å¿µ
- [ ] æŒæ¡æœåŠ¡çŠ¶æ€ç›‘æ§æ–¹æ³•
- [ ] äº†è§£å¼‚å¸¸è¡Œä¸ºæ£€æµ‹åŸç†
- [ ] ç†Ÿæ‚‰èµ„æºç›‘æ§æŒ‡æ ‡

**è¿›é˜¶åº”ç”¨ âœ“**
- [ ] é…ç½®auditdæ–‡ä»¶å®¡è®¡
- [ ] å»ºç«‹è¿›ç¨‹è¡Œä¸ºåŸºçº¿
- [ ] ç¼–å†™è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬
- [ ] è®¾è®¡äº‹ä»¶å“åº”æµç¨‹

**å®æˆ˜èƒ½åŠ› âœ“**
- [ ] èƒ½å¤Ÿåˆ†æå®‰å…¨äº‹ä»¶
- [ ] èƒ½å¤Ÿæ‰§è¡Œåº”æ€¥å“åº”
- [ ] èƒ½å¤Ÿè¿›è¡Œè¯æ®ä¿å…¨
- [ ] èƒ½å¤Ÿä¼˜åŒ–ç›‘æ§ç­–ç•¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è¿è¡Œç›‘æ§ä¿å®‰å…¨ï¼ŒåŸºçº¿å»ºç«‹æ˜¯å…³é”®
å¼‚å¸¸æ£€æµ‹è¦åŠæ—¶ï¼Œå“åº”å¤„ç†è«æ‹–å»¶
è¿›ç¨‹ç½‘ç»œæ–‡ä»¶æŸ¥ï¼Œæƒé™æå‡è¦ä¸¥é˜²
æ—¥å¿—å®¡è®¡åšåˆ°ä½ï¼Œå®‰å…¨è¿ç»´å¿ƒä¸æ…Œ
```

**å®è·µå»ºè®®**ï¼š
1. **ä»ç®€å•å¼€å§‹** - å…ˆç›‘æ§åŸºæœ¬çš„CPUã€å†…å­˜ã€ç£ç›˜
2. **é€æ­¥æ‰©å±•** - æ ¹æ®éœ€è¦å¢åŠ ç›‘æ§é¡¹ç›®  
3. **é‡è§†åŸºçº¿** - èŠ±æ—¶é—´å»ºç«‹å‡†ç¡®çš„è¡Œä¸ºåŸºçº¿
4. **æµ‹è¯•å“åº”** - å®šæœŸæµ‹è¯•å‘Šè­¦å’Œå“åº”æµç¨‹
5. **æŒç»­æ”¹è¿›** - æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–ç›‘æ§ç­–ç•¥