---
title: 2ã€æœåŠ¡å•å…ƒæ–‡ä»¶é«˜çº§é…ç½®
---
## ğŸ“š ç›®å½•

1. [systemdæœåŠ¡å•å…ƒæ–‡ä»¶åŸºç¡€æ¦‚å¿µ](#1-systemdæœåŠ¡å•å…ƒæ–‡ä»¶åŸºç¡€æ¦‚å¿µ)
2. [Unitæ®µæ ¸å¿ƒé…ç½®è¯¦è§£](#2-Unitæ®µæ ¸å¿ƒé…ç½®è¯¦è§£)
3. [Serviceæ®µé«˜çº§é…ç½®](#3-Serviceæ®µé«˜çº§é…ç½®)
4. [Installæ®µé…ç½®ä¸ä¾èµ–ç®¡ç†](#4-Installæ®µé…ç½®ä¸ä¾èµ–ç®¡ç†)
5. [æœåŠ¡ç±»å‹æ·±å…¥ç†è§£](#5-æœåŠ¡ç±»å‹æ·±å…¥ç†è§£)
6. [é‡å¯ç­–ç•¥ä¸æ•…éšœå¤„ç†](#6-é‡å¯ç­–ç•¥ä¸æ•…éšœå¤„ç†)
7. [ç¯å¢ƒå˜é‡ä¸è¿è¡Œç¯å¢ƒé…ç½®](#7-ç¯å¢ƒå˜é‡ä¸è¿è¡Œç¯å¢ƒé…ç½®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ systemdæœåŠ¡å•å…ƒæ–‡ä»¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡å•å…ƒæ–‡ä»¶


**ğŸ’­ é€šä¿—ç†è§£**
```
systemdæœåŠ¡å•å…ƒæ–‡ä»¶å°±åƒæ˜¯ç»™ç³»ç»ŸæœåŠ¡å†™çš„"è¯´æ˜ä¹¦"ï¼š
â€¢ å‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªæœåŠ¡æ˜¯ä»€ä¹ˆ
â€¢ å‘Šè¯‰ç³»ç»Ÿæ€ä¹ˆå¯åŠ¨è¿™ä¸ªæœåŠ¡  
â€¢ å‘Šè¯‰ç³»ç»ŸæœåŠ¡å‡ºé—®é¢˜äº†æ€ä¹ˆåŠ
â€¢ å‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªæœåŠ¡ä¾èµ–ä»€ä¹ˆ

å°±åƒä½ ç»™æœ‹å‹å†™ä½¿ç”¨æ‰‹å†Œä¸€æ ·è¯¦ç»†ï¼
```

**ğŸ”§ æœåŠ¡æ–‡ä»¶åŸºæœ¬ç»“æ„**
```ini
# /etc/systemd/system/myapp.service
[Unit]                    # åŸºæœ¬ä¿¡æ¯æ®µ
Description=æˆ‘çš„åº”ç”¨æœåŠ¡
After=network.target

[Service]                 # æœåŠ¡è¿è¡Œæ®µ  
Type=simple
ExecStart=/usr/bin/myapp
Restart=always

[Install]                 # å®‰è£…é…ç½®æ®µ
WantedBy=multi-user.target
```

### 1.2 æœåŠ¡æ–‡ä»¶çš„ä½ç½®å’Œä¼˜å…ˆçº§


**ğŸ“ æ–‡ä»¶ä½ç½®ä¼˜å…ˆçº§**
```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š
1. /etc/systemd/system/          â† ç®¡ç†å‘˜è‡ªå®šä¹‰ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
2. /run/systemd/system/          â† è¿è¡Œæ—¶åˆ›å»ºçš„æœåŠ¡
3. /usr/lib/systemd/system/      â† ç³»ç»Ÿé»˜è®¤æœåŠ¡

è®°å¿†æŠ€å·§ï¼šetc > run > usrï¼ˆæŒ‰å­—æ¯é¡ºåºç›¸åï¼‰
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
- **è‡ªå®šä¹‰æœåŠ¡**ï¼šæ”¾åœ¨ `/etc/systemd/system/`
- **è¦†ç›–ç³»ç»ŸæœåŠ¡**ï¼šåœ¨ `/etc/systemd/system/` åˆ›å»ºåŒåæ–‡ä»¶
- **ä¸´æ—¶æœåŠ¡**ï¼šç³»ç»Ÿè‡ªåŠ¨æ”¾åœ¨ `/run/systemd/system/`

---

## 2. ğŸ“‹ Unitæ®µæ ¸å¿ƒé…ç½®è¯¦è§£


### 2.1 åŸºæœ¬æè¿°é…ç½®


**ğŸ·ï¸ Description - æœåŠ¡æè¿°**
```ini
[Unit]
Description=æˆ‘çš„Webåº”ç”¨æœåŠ¡
# ä½œç”¨ï¼šåœ¨ systemctl status æ—¶æ˜¾ç¤ºçš„å‹å¥½åç§°
# å»ºè®®ï¼šç”¨ä¸­æ–‡æˆ–ç®€æ´çš„è‹±æ–‡æè¿°æœåŠ¡åŠŸèƒ½
```

**ğŸ“– Documentation - æ–‡æ¡£é“¾æ¥**
```ini
[Unit]
Documentation=https://myapp.example.com/docs
Documentation=man:myapp(8)
# ä½œç”¨ï¼šæä¾›æœåŠ¡ç›¸å…³æ–‡æ¡£çš„é“¾æ¥
# æ”¯æŒï¼šhttpã€httpsã€fileã€manç­‰å¤šç§æ ¼å¼
```

### 2.2 æœåŠ¡ä¾èµ–å…³ç³»é…ç½®


**â° After/Before - å¯åŠ¨é¡ºåº**
```ini
[Unit]
# åœ¨ç½‘ç»œæœåŠ¡å¯åŠ¨åå†å¯åŠ¨
After=network.target network-online.target

# åœ¨å…¶ä»–æœåŠ¡ä¹‹å‰å¯åŠ¨
Before=apache2.service

# é€šä¿—ç†è§£ï¼š
# Afterï¼šç­‰åˆ«äººå¯åŠ¨å®Œæˆ‘å†å¯åŠ¨
# Beforeï¼šæˆ‘è¦åœ¨åˆ«äººä¹‹å‰å¯åŠ¨
```

**ğŸ”— Requires/Wants - ä¾èµ–éœ€æ±‚**
```ini
[Unit]
# å¼ºä¾èµ–ï¼šå¿…é¡»æˆåŠŸå¯åŠ¨ï¼Œå¦åˆ™æˆ‘ä¹Ÿå¤±è´¥
Requires=postgresql.service

# å¼±ä¾èµ–ï¼šå¸Œæœ›å®ƒå¯åŠ¨ï¼Œä½†å¤±è´¥äº†æˆ‘ä¹Ÿèƒ½è¿è¡Œ
Wants=redis.service

# é€‰æ‹©å»ºè®®ï¼š
# æ•°æ®åº“è¿™ç§å¿…éœ€æœåŠ¡ç”¨ Requires
# ç¼“å­˜è¿™ç§å¯é€‰æœåŠ¡ç”¨ Wants
```

### 2.3 å†²çªå’Œæ¡ä»¶é…ç½®


**âš ï¸ Conflicts - æœåŠ¡å†²çª**
```ini
[Unit]
# ä¸èƒ½å’Œå…¶ä»–æœåŠ¡åŒæ—¶è¿è¡Œ
Conflicts=another-webserver.service
# ä¾‹å¦‚ï¼šnginxå’Œapacheä¸èƒ½åŒæ—¶ç»‘å®š80ç«¯å£
```

**ğŸ¯ Conditionæ£€æŸ¥**
```ini
[Unit]
# åªæœ‰å½“æ–‡ä»¶å­˜åœ¨æ—¶æ‰å¯åŠ¨
ConditionPathExists=/etc/myapp/config.conf

# åªæœ‰å½“ç«¯å£æœªè¢«å ç”¨æ—¶æ‰å¯åŠ¨
ConditionPathExists=!/var/run/myapp.pid

# å¸¸ç”¨æ¡ä»¶æ£€æŸ¥ï¼š
# ConditionPathExists=    æ–‡ä»¶æ˜¯å¦å­˜åœ¨
# ConditionUser=         æŒ‡å®šç”¨æˆ·æ‰èƒ½å¯åŠ¨
# ConditionHost=         æŒ‡å®šä¸»æœºåæ‰å¯åŠ¨
```

---

## 3. âš™ï¸ Serviceæ®µé«˜çº§é…ç½®


### 3.1 æœåŠ¡æ‰§è¡Œé…ç½®


**ğŸš€ ExecStart - å¯åŠ¨å‘½ä»¤**
```ini
[Service]
# ç®€å•å‘½ä»¤
ExecStart=/usr/bin/myapp

# å¸¦å‚æ•°çš„å‘½ä»¤
ExecStart=/usr/bin/myapp --config /etc/myapp.conf --daemon

# å¤šä¸ªå‘½ä»¤ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰
ExecStart=/usr/bin/prepare.sh
ExecStart=/usr/bin/myapp

# æ³¨æ„äº‹é¡¹ï¼š
# - å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„
# - å¦‚æœå‘½ä»¤å¤±è´¥ï¼ŒæœåŠ¡å¯åŠ¨å¤±è´¥
```

**ğŸ›‘ ExecStop - åœæ­¢å‘½ä»¤**
```ini
[Service]
# ä¼˜é›…åœæ­¢
ExecStop=/bin/kill -TERM $MAINPID

# è‡ªå®šä¹‰åœæ­¢è„šæœ¬
ExecStop=/usr/bin/myapp-stop.sh

# å¦‚æœä¸æŒ‡å®šï¼Œsystemdä¼šå‘é€SIGTERMä¿¡å·
```

**ğŸ”„ ExecReload - é‡è½½é…ç½®**
```ini
[Service]
# é‡è½½é…ç½®æ–‡ä»¶ï¼ˆä¸é‡å¯æœåŠ¡ï¼‰
ExecReload=/bin/kill -HUP $MAINPID

# æˆ–è€…è°ƒç”¨åº”ç”¨çš„é‡è½½åŠŸèƒ½
ExecReload=/usr/bin/myapp --reload

# ä½œç”¨ï¼šæ”¯æŒ systemctl reload myapp å‘½ä»¤
```

### 3.2 æœåŠ¡è¿è¡Œç¯å¢ƒé…ç½®


**ğŸ‘¤ User/Group - è¿è¡Œç”¨æˆ·**
```ini
[Service]
User=webapp
Group=webapp

# å®‰å…¨å»ºè®®ï¼š
# - ä¸è¦ç”¨rootè¿è¡Œåº”ç”¨æœåŠ¡
# - ä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºä¸“é—¨çš„ç”¨æˆ·
# - ç”¨æˆ·æƒé™æœ€å°åŒ–
```

**ğŸ“ WorkingDirectory - å·¥ä½œç›®å½•**
```ini
[Service]
WorkingDirectory=/var/lib/myapp

# ä½œç”¨ï¼š
# - è®¾ç½®æœåŠ¡çš„å·¥ä½œç›®å½•
# - ç›¸å¯¹è·¯å¾„ä»¥æ­¤ä¸ºåŸºå‡†
# - é…ç½®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ä½ç½®
```

---

## 4. ğŸ”§ Installæ®µé…ç½®ä¸ä¾èµ–ç®¡ç†


### 4.1 å®‰è£…ç›®æ ‡é…ç½®


**ğŸ¯ WantedBy - è¢«å“ªä¸ªç›®æ ‡éœ€è¦**
```ini
[Install]
WantedBy=multi-user.target

# å¸¸ç”¨ç›®æ ‡ï¼š
# multi-user.target    # å¤šç”¨æˆ·æ¨¡å¼ï¼ˆå‘½ä»¤è¡Œï¼‰
# graphical.target     # å›¾å½¢ç•Œé¢æ¨¡å¼
# default.target       # ç³»ç»Ÿé»˜è®¤ç›®æ ‡
```

**ğŸ“‹ ç›®æ ‡å¯¹åº”å…³ç³»è¡¨**
| ç›®æ ‡åç§° | **è¿è¡Œçº§åˆ«** | **è¯´æ˜** | **å…¸å‹æœåŠ¡** |
|---------|-------------|---------|-------------|
| `graphical.target` | `çº§åˆ«5` | å›¾å½¢ç•Œé¢æ¨¡å¼ | æ¡Œé¢æœåŠ¡ã€æ˜¾ç¤ºç®¡ç†å™¨ |
| `multi-user.target` | `çº§åˆ«3` | å¤šç”¨æˆ·å‘½ä»¤è¡Œæ¨¡å¼ | WebæœåŠ¡å™¨ã€æ•°æ®åº“ |
| `rescue.target` | `çº§åˆ«1` | æ•‘æ´æ¨¡å¼ | åŸºç¡€ç³»ç»ŸæœåŠ¡ |

### 4.2 æœåŠ¡å…³è”é…ç½®


**ğŸ”— RequiredBy - è¢«è°å¼ºåˆ¶éœ€è¦**
```ini
[Install]
RequiredBy=web-application.target

# å«ä¹‰ï¼šå½“web-application.targetå¯åŠ¨æ—¶
# å¿…é¡»å…ˆå¯åŠ¨æˆ‘è¿™ä¸ªæœåŠ¡
```

**â• Also - åŒæ—¶å¯ç”¨çš„æœåŠ¡**
```ini
[Install]
Also=myapp-worker.service myapp-scheduler.service

# ä½œç”¨ï¼šæ‰§è¡Œ systemctl enable myapp æ—¶
# è‡ªåŠ¨åŒæ—¶å¯ç”¨ç›¸å…³è”çš„æœåŠ¡
```

---

## 5. ğŸ—ï¸ æœåŠ¡ç±»å‹æ·±å…¥ç†è§£


### 5.1 æœåŠ¡ç±»å‹å¯¹æ¯”


**ğŸ“Š æœåŠ¡ç±»å‹ç‰¹ç‚¹å¯¹æ¯”**
```
Type=simple     ç¨‹åºç›´æ¥è¿è¡Œï¼Œä¸fork         Webåº”ç”¨ã€APIæœåŠ¡
Type=forking    ç¨‹åºä¼šforkåå°è¿è¡Œ          ä¼ ç»Ÿå®ˆæŠ¤è¿›ç¨‹
Type=oneshot    æ‰§è¡Œä¸€æ¬¡å°±ç»“æŸçš„ä»»åŠ¡         åˆå§‹åŒ–è„šæœ¬
Type=notify     ç¨‹åºä¼šé€šçŸ¥systemdå‡†å¤‡å°±ç»ª    ç°ä»£åº”ç”¨ç¨‹åº
Type=idle       ç­‰å…¶ä»–æœåŠ¡å®Œæˆåå†å¯åŠ¨       ä½ä¼˜å…ˆçº§æœåŠ¡
```

### 5.2 Type=simple è¯¦è§£


**ğŸ’­ é€‚ç”¨åœºæ™¯**
```ini
[Service]
Type=simple
ExecStart=/usr/bin/node /var/www/myapp/server.js

# ç‰¹ç‚¹ï¼š
# âœ… ç¨‹åºå‰å°è¿è¡Œï¼Œä¸ä¼šè‡ªå·±å˜æˆå®ˆæŠ¤è¿›ç¨‹  
# âœ… systemdç›´æ¥ç®¡ç†è¿™ä¸ªè¿›ç¨‹
# âœ… æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„ç±»å‹

# é€‚åˆï¼š
# - Webåº”ç”¨ï¼ˆNode.jsã€Python Flaskç­‰ï¼‰
# - APIæœåŠ¡
# - å¾®æœåŠ¡ç¨‹åº
```

### 5.3 Type=forking è¯¦è§£


**ğŸ”„ ä¼ ç»Ÿå®ˆæŠ¤è¿›ç¨‹**
```ini
[Service]
Type=forking
PIDFile=/var/run/myapp.pid
ExecStart=/usr/bin/myapp-daemon

# å·¥ä½œæµç¨‹ï¼š
# 1. å¯åŠ¨å‘½ä»¤æ‰§è¡Œ
# 2. ç¨‹åºforkå‡ºå­è¿›ç¨‹
# 3. çˆ¶è¿›ç¨‹é€€å‡º
# 4. systemdé€šè¿‡PIDæ–‡ä»¶è·Ÿè¸ªå­è¿›ç¨‹

# é€‚åˆï¼š
# - ä¼ ç»Ÿçš„C/C++å®ˆæŠ¤è¿›ç¨‹
# - Apacheã€Nginxï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰
```

### 5.4 Type=oneshot è¯¦è§£


**âš¡ ä¸€æ¬¡æ€§ä»»åŠ¡**
```ini
[Service]
Type=oneshot
ExecStart=/usr/bin/setup-database.sh
RemainAfterExit=yes

# ç‰¹ç‚¹ï¼š
# âœ… æ‰§è¡Œå®Œå°±ç»“æŸï¼Œä¸ä¿æŒè¿è¡ŒçŠ¶æ€
# âœ… RemainAfterExit=yes è®©systemdè®¤ä¸ºæœåŠ¡ä»ç„¶æ´»è·ƒ

# é€‚åˆï¼š
# - ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬
# - æ•°æ®åº“è¿ç§»ä»»åŠ¡
# - ä¸€æ¬¡æ€§é…ç½®ä»»åŠ¡
```

### 5.5 Type=notify è¯¦è§£


**ğŸ“¢ é€šçŸ¥å‹æœåŠ¡**
```ini
[Service]
Type=notify
ExecStart=/usr/bin/modern-app
NotifyAccess=main

# å·¥ä½œåŸç†ï¼š
# 1. ç¨‹åºå¯åŠ¨åè¿›è¡Œåˆå§‹åŒ–
# 2. å‡†å¤‡å°±ç»ªåè°ƒç”¨ sd_notify() é€šçŸ¥systemd
# 3. systemdæ”¶åˆ°é€šçŸ¥æ‰è®¤ä¸ºæœåŠ¡å¯åŠ¨æˆåŠŸ

# é€‚åˆï¼š
# - ç°ä»£åº”ç”¨ç¨‹åºï¼ˆæ”¯æŒsystemdé€šçŸ¥ï¼‰
# - éœ€è¦è¾ƒé•¿åˆå§‹åŒ–æ—¶é—´çš„æœåŠ¡
```

---

## 6. ğŸ”„ é‡å¯ç­–ç•¥ä¸æ•…éšœå¤„ç†


### 6.1 é‡å¯ç­–ç•¥é…ç½®


**ğŸ” Restartç­–ç•¥è¯¦è§£**
```ini
[Service]
Restart=on-failure
RestartSec=5
StartLimitBurst=3
StartLimitIntervalSec=10

# Restarté€‰é¡¹ï¼š
# no          - ä¸è‡ªåŠ¨é‡å¯ï¼ˆé»˜è®¤ï¼‰
# always      - ä»»ä½•æƒ…å†µä¸‹éƒ½é‡å¯
# on-failure  - åªåœ¨å¤±è´¥æ—¶é‡å¯ï¼ˆæ¨èï¼‰
# on-abnormal - åªåœ¨å¼‚å¸¸ç»ˆæ­¢æ—¶é‡å¯
# on-abort    - åªåœ¨æ”¶åˆ°æœªå¤„ç†ä¿¡å·æ—¶é‡å¯
```

**â±ï¸ é‡å¯æ—¶é—´æ§åˆ¶**
```ini
[Service]
# é‡å¯å‰ç­‰å¾…æ—¶é—´
RestartSec=5

# è¿ç»­é‡å¯é™åˆ¶ï¼ˆé˜²æ­¢æ— é™é‡å¯ï¼‰
StartLimitBurst=3        # 3æ¬¡é‡å¯æœºä¼š
StartLimitIntervalSec=10  # 10ç§’å†…

# å«ä¹‰ï¼š10ç§’å†…æœ€å¤šé‡å¯3æ¬¡ï¼Œè¶…è¿‡åˆ™åœæ­¢å°è¯•
```

### 6.2 æ•…éšœå¤„ç†ç­–ç•¥


**âš ï¸ è¶…æ—¶è®¾ç½®**
```ini
[Service]
TimeoutStartSec=30    # å¯åŠ¨è¶…æ—¶30ç§’
TimeoutStopSec=30     # åœæ­¢è¶…æ—¶30ç§’
TimeoutSec=30         # åŒæ—¶è®¾ç½®å¯åŠ¨å’Œåœæ­¢è¶…æ—¶

# å»ºè®®å€¼ï¼š
# å¿«é€Ÿå¯åŠ¨æœåŠ¡ï¼š10-30ç§’
# æ•°æ®åº“æœåŠ¡ï¼š60-120ç§’
# å¤§å‹åº”ç”¨ï¼š120-300ç§’
```

**ğŸš¨ å¤±è´¥å¤„ç†**
```ini
[Service]
# å¯åŠ¨å¤±è´¥æ—¶çš„åŠ¨ä½œ
OnFailure=notify-admin.service

# å¯é€‰åŠ¨ä½œï¼š
# reboot.target      - é‡å¯ç³»ç»Ÿ
# poweroff.target    - å…³æœº
# è‡ªå®šä¹‰æœåŠ¡        - æ‰§è¡Œç‰¹å®šå¤„ç†
```

---

## 7. ğŸŒ ç¯å¢ƒå˜é‡ä¸è¿è¡Œç¯å¢ƒé…ç½®


### 7.1 ç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•


**ğŸ”§ ç›´æ¥é…ç½®ç¯å¢ƒå˜é‡**
```ini
[Service]
Environment=NODE_ENV=production
Environment=DATABASE_URL=postgresql://user:pass@localhost/mydb
Environment="PATH=/usr/local/bin:/usr/bin:/bin"

# å¤šä¸ªå˜é‡é…ç½®ï¼š
Environment=VAR1=value1 VAR2=value2
```

**ğŸ“„ ä»æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡**
```ini
[Service]
EnvironmentFile=/etc/myapp/environment
EnvironmentFile=-/etc/myapp/optional.env

# æ–‡ä»¶æ ¼å¼ï¼ˆ/etc/myapp/environmentï¼‰ï¼š
NODE_ENV=production
DATABASE_URL=postgresql://localhost/mydb
API_KEY=your-secret-key

# æ³¨æ„ï¼š- å‰ç¼€è¡¨ç¤ºæ–‡ä»¶å¯é€‰ï¼ˆä¸å­˜åœ¨ä¸ä¼šæŠ¥é”™ï¼‰
```

### 7.2 å®‰å…¨é…ç½®


**ğŸ”’ æƒé™é™åˆ¶**
```ini
[Service]
# ç¦æ­¢è®¿é—®ç½‘ç»œ
PrivateNetwork=yes

# åªè¯»æ–‡ä»¶ç³»ç»Ÿ
ReadOnlyPaths=/etc /usr

# ç¦æ­¢è®¿é—®å…¶ä»–ç”¨æˆ·ç›®å½•
ProtectHome=yes

# ç¦æ­¢è®¿é—®ç³»ç»Ÿç›®å½•
ProtectSystem=strict

# ä¸´æ—¶ç›®å½•éš”ç¦»
PrivateTmp=yes
```

**ğŸ›¡ï¸ èµ„æºé™åˆ¶**
```ini
[Service]
# å†…å­˜é™åˆ¶
MemoryLimit=512M

# CPUé™åˆ¶ï¼ˆç›¸å¯¹æƒé‡ï¼‰
CPUShares=512

# æ–‡ä»¶æ‰“å¼€æ•°é™åˆ¶
LimitNOFILE=1024

# è¿›ç¨‹æ•°é™åˆ¶
LimitNPROC=100
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒé…ç½®


```ini
# æœ€å°åŒ–å¯ç”¨é…ç½®
[Unit]
Description=æˆ‘çš„åº”ç”¨æœåŠ¡
After=network.target

[Service]  
Type=simple
ExecStart=/usr/bin/myapp
Restart=on-failure
User=myapp

[Install]
WantedBy=multi-user.target
```

### 8.2 æœåŠ¡ç±»å‹é€‰æ‹©æŒ‡å—


**ğŸ¯ ç±»å‹é€‰æ‹©æµç¨‹å›¾**
```
æˆ‘çš„ç¨‹åºæ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ
    â”œâ”€â”€ å‰å°è¿è¡Œçš„ç¨‹åº â†’ Type=simple
    â”œâ”€â”€ ä¼ ç»Ÿå®ˆæŠ¤è¿›ç¨‹   â†’ Type=forking
    â”œâ”€â”€ ä¸€æ¬¡æ€§ä»»åŠ¡     â†’ Type=oneshot
    â”œâ”€â”€ æ”¯æŒsystemdé€šçŸ¥ â†’ Type=notify
    â””â”€â”€ ä½ä¼˜å…ˆçº§æœåŠ¡   â†’ Type=idle
```

### 8.3 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èé…ç½®**
```ini
[Unit]
Description=æ˜ç¡®çš„æœåŠ¡æè¿°
After=network.target        # å¤§éƒ¨åˆ†æœåŠ¡éƒ½éœ€è¦ç½‘ç»œ

[Service]
Type=simple                 # é¦–é€‰ç±»å‹
Restart=on-failure         # åªåœ¨å¤±è´¥æ—¶é‡å¯
RestartSec=5               # é¿å…é¢‘ç¹é‡å¯
User=ä¸“ç”¨ç”¨æˆ·               # å®‰å…¨ç¬¬ä¸€
WorkingDirectory=åº”ç”¨ç›®å½•    # æ˜ç¡®å·¥ä½œç›®å½•

[Install]
WantedBy=multi-user.target  # æ ‡å‡†ç›®æ ‡
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
- ğŸ”¸ **æ°¸è¿œä¸è¦ç”¨rootè¿è¡Œåº”ç”¨æœåŠ¡**
- ğŸ”¸ **è®¾ç½®é€‚å½“çš„é‡å¯é™åˆ¶é¿å…æ— é™é‡å¯**  
- ğŸ”¸ **æ•æ„Ÿä¿¡æ¯æ”¾åœ¨ç¯å¢ƒæ–‡ä»¶ä¸­ï¼Œä¸è¦ç›´æ¥å†™åœ¨æœåŠ¡æ–‡ä»¶é‡Œ**
- ğŸ”¸ **åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé¿å…æœåŠ¡å‡æ­»**

### 8.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¼ä¸šåœºæ™¯åº”ç”¨**
- **Webåº”ç”¨éƒ¨ç½²**ï¼šé…ç½®ç”Ÿäº§ç¯å¢ƒçš„WebæœåŠ¡
- **å¾®æœåŠ¡ç®¡ç†**ï¼šç®¡ç†å®¹å™¨åŒ–ä¹‹å‰çš„å¾®æœåŠ¡
- **åå°ä»»åŠ¡**ï¼šå®šæ—¶ä»»åŠ¡å’Œæ•°æ®å¤„ç†æœåŠ¡
- **ç³»ç»ŸæœåŠ¡**ï¼šè‡ªå®šä¹‰ç³»ç»Ÿçº§åˆ«çš„æœåŠ¡

**ğŸ”§ è¿ç»´å®è·µ**
- **æœåŠ¡æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„æœåŠ¡é…ç½®æ¨¡æ¿
- **æ•…éšœè‡ªæ„ˆ**ï¼šåˆç†çš„é‡å¯ç­–ç•¥å‡å°‘äººå·¥å¹²é¢„
- **å®‰å…¨åŠ å›º**ï¼šæƒé™æ§åˆ¶å’Œèµ„æºé™åˆ¶
- **ç›‘æ§é›†æˆ**ï¼šé…åˆsystemdçš„æ—¥å¿—å’ŒçŠ¶æ€ç›‘æ§

**ğŸ’¡ æ ¸å¿ƒè®°å¿†**
```
ğŸ·ï¸ Unitæ®µï¼šæœåŠ¡åŸºæœ¬ä¿¡æ¯å’Œä¾èµ–å…³ç³»
âš™ï¸ Serviceæ®µï¼šæœåŠ¡å¦‚ä½•è¿è¡Œå’Œé‡å¯
ğŸ”§ Installæ®µï¼šæœåŠ¡å¦‚ä½•å®‰è£…å’Œå¯ç”¨

è®°å¿†å£è¯€ï¼š
- Unitè®²å…³ç³»ï¼ŒServiceè®²è¿è¡Œï¼ŒInstallè®²å®‰è£…
- simpleæœ€å¸¸ç”¨ï¼Œforkingæ˜¯ä¼ ç»Ÿï¼Œoneshotæ˜¯ä¸€æ¬¡
- on-failureé‡å¯å¥½ï¼Œalwayså¤ªæš´åŠ›ï¼Œnoå¤ªè¢«åŠ¨
```