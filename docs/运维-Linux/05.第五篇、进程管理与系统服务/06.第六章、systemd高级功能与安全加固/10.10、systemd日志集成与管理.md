---
title: 10ã€systemdæ—¥å¿—é›†æˆä¸ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [journaldä¸systemdé›†æˆæœºåˆ¶](#1-journaldä¸systemdé›†æˆæœºåˆ¶)
2. [æœåŠ¡æ—¥å¿—é…ç½®è¯¦è§£](#2-æœåŠ¡æ—¥å¿—é…ç½®è¯¦è§£)
3. [æ—¥å¿—å­—æ®µæ ‡å‡†åŒ–](#3-æ—¥å¿—å­—æ®µæ ‡å‡†åŒ–)
4. [ç»“æ„åŒ–æ—¥å¿—è®°å½•æœ€ä½³å®è·µ](#4-ç»“æ„åŒ–æ—¥å¿—è®°å½•æœ€ä½³å®è·µ)
5. [æ—¥å¿—æŒä¹…åŒ–é…ç½®](#5-æ—¥å¿—æŒä¹…åŒ–é…ç½®)
6. [æœåŠ¡æ—¥å¿—æŸ¥è¯¢æŠ€å·§](#6-æœåŠ¡æ—¥å¿—æŸ¥è¯¢æŠ€å·§)
7. [æ—¥å¿—è½¬å‘ä¸é›†æˆ](#7-æ—¥å¿—è½¬å‘ä¸é›†æˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— journaldä¸systemdé›†æˆæœºåˆ¶


### 1.1 ä»€ä¹ˆæ˜¯journald


**ç®€å•ç†è§£**ï¼šjournaldå°±åƒæ˜¯Linuxç³»ç»Ÿçš„"å¤§ç®¡å®¶æ—¥å¿—æœ¬"

```
ä¼ ç»Ÿæ—¥å¿—ç³»ç»Ÿï¼š          systemd + journaldï¼š
åº”ç”¨ç¨‹åº                   åº”ç”¨ç¨‹åº
   â†“                        â†“
syslogå®ˆæŠ¤è¿›ç¨‹    vs      systemdæœåŠ¡
   â†“                        â†“
æ–‡æœ¬æ—¥å¿—æ–‡ä»¶              journaldï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **ç»Ÿä¸€æ”¶é›†**ï¼šæ‰€æœ‰systemdç®¡ç†çš„æœåŠ¡æ—¥å¿—éƒ½ä¼šè‡ªåŠ¨æ”¶é›†
- **äºŒè¿›åˆ¶å­˜å‚¨**ï¼šä¸æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œè€Œæ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼ŒæŸ¥è¯¢æ›´å¿«
- **ç»“æ„åŒ–æ•°æ®**ï¼šæ¯æ¡æ—¥å¿—éƒ½æœ‰æ ‡å‡†åŒ–çš„å­—æ®µä¿¡æ¯
- **è‡ªåŠ¨ç®¡ç†**ï¼šè‡ªåŠ¨è½®è½¬ã€å‹ç¼©ï¼Œä¸ç”¨æ‰‹åŠ¨æ¸…ç†

### 1.2 é›†æˆå·¥ä½œåŸç†


**ğŸ”§ å·¥ä½œæµç¨‹å›¾**ï¼š
```
[åº”ç”¨ç¨‹åº] â†’ [stdout/stderr] â†’ [systemdæœåŠ¡] â†’ [journald] â†’ [æ—¥å¿—å­˜å‚¨]
     â†“              â†“               â†“            â†“           â†“
  ç¨‹åºè¾“å‡º        æ ‡å‡†è¾“å‡ºæµ      æœåŠ¡ç®¡ç†å™¨    æ—¥å¿—æœåŠ¡    äºŒè¿›åˆ¶æ—¥å¿—åº“
```

**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
- ä½ çš„ç¨‹åºå°±åƒåœ¨è¯´è¯ï¼ˆè¾“å‡ºæ—¥å¿—ï¼‰
- systemdå°±åƒç¿»è¯‘å®˜ï¼ŒæŠŠç¨‹åºçš„è¯æ”¶é›†èµ·æ¥
- journaldå°±åƒè®°å½•å‘˜ï¼ŒæŠŠè¿™äº›è¯æŒ‰ç»Ÿä¸€æ ¼å¼è®°å½•ä¸‹æ¥
- æœ€åå­˜å‚¨åœ¨ä¸€ä¸ª"æ™ºèƒ½æ—¥å¿—æœ¬"é‡Œï¼Œæ–¹ä¾¿æŸ¥æ‰¾

### 1.3 ä¸ä¼ ç»Ÿsyslogçš„åŒºåˆ«


| ç‰¹æ€§ | **ä¼ ç»Ÿsyslog** | **systemd journald** |
|-----|--------------|-------------------|
| ğŸ“„ **å­˜å‚¨æ ¼å¼** | `æ–‡æœ¬æ–‡ä»¶` | `äºŒè¿›åˆ¶æ ¼å¼` |
| ğŸ” **æŸ¥è¯¢æ–¹å¼** | `grep/awkç­‰æ–‡æœ¬å·¥å…·` | `journalctlä¸“ç”¨å·¥å…·` |
| ğŸ·ï¸ **æ•°æ®ç»“æ„** | `éç»“æ„åŒ–æ–‡æœ¬` | `ç»“æ„åŒ–å­—æ®µ` |
| âš¡ **æ€§èƒ½** | `æŸ¥è¯¢è¾ƒæ…¢` | `ç´¢å¼•æŸ¥è¯¢å¿«é€Ÿ` |
| ğŸ”§ **ç®¡ç†** | `éœ€è¦æ‰‹åŠ¨é…ç½®è½®è½¬` | `è‡ªåŠ¨ç®¡ç†å’Œæ¸…ç†` |

---

## 2. ğŸ› ï¸ æœåŠ¡æ—¥å¿—é…ç½®è¯¦è§£


### 2.1 StandardOutputé…ç½®


**ğŸ’­ StandardOutputæ˜¯ä»€ä¹ˆï¼Ÿ**
å°±æ˜¯å‘Šè¯‰systemdï¼š"æˆ‘çš„ç¨‹åºè¾“å‡ºçš„å†…å®¹ä½ æ€ä¹ˆå¤„ç†ï¼Ÿ"

```ini
# åœ¨ /etc/systemd/system/myapp.service ä¸­é…ç½®
[Unit]
Description=æˆ‘çš„åº”ç”¨ç¨‹åº
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/myapp
User=myapp

# å…³é”®é…ç½®ï¼šè¾“å‡ºå¤„ç†æ–¹å¼
StandardOutput=journal     # å‘é€åˆ°journald
StandardError=journal      # é”™è¯¯ä¹Ÿå‘é€åˆ°journald
SyslogIdentifier=myapp     # æ—¥å¿—æ ‡è¯†ç¬¦

[Install]
WantedBy=multi-user.target
```

**ğŸ”¸ StandardOutputå¯é€‰å€¼**ï¼š

| é…ç½®å€¼ | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** |
|--------|---------|-------------|
| `journal` | `å‘é€åˆ°journald` | `å¤§éƒ¨åˆ†æœåŠ¡çš„æ ‡å‡†é€‰æ‹©` |
| `syslog` | `å‘é€åˆ°ä¼ ç»Ÿsyslog` | `å…¼å®¹æ—§ç³»ç»Ÿ` |
| `null` | `ä¸¢å¼ƒè¾“å‡º` | `ä¸éœ€è¦æ—¥å¿—çš„æœåŠ¡` |
| `file:/path/to/log` | `ç›´æ¥å†™å…¥æ–‡ä»¶` | `éœ€è¦ç‹¬ç«‹æ—¥å¿—æ–‡ä»¶` |
| `socket` | `å‘é€åˆ°socket` | `è‡ªå®šä¹‰æ—¥å¿—å¤„ç†` |

### 2.2 StandardErroré…ç½®


**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```ini
# ç¤ºä¾‹ï¼šWebæœåŠ¡é…ç½®
[Service]
StandardOutput=journal    # æ­£å¸¸è¾“å‡ºåˆ°journald
StandardError=journal     # é”™è¯¯è¾“å‡ºä¹Ÿåˆ°journald
SyslogIdentifier=webapp   # æ—¥å¿—ä¸­æ˜¾ç¤ºä¸ºwebapp

# ç¤ºä¾‹ï¼šè°ƒè¯•æ¨¡å¼é…ç½®  
[Service]
StandardOutput=journal
StandardError=file:/var/log/myapp/debug.log  # é”™è¯¯å•ç‹¬è®°å½•
SyslogIdentifier=myapp-debug
```

### 2.3 SyslogIdentifierçš„é‡è¦æ€§


**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦SyslogIdentifierï¼Ÿ**

```bash
# æ²¡æœ‰è®¾ç½®SyslogIdentifierçš„æƒ…å†µ
$ journalctl -f
Sep 14 15:30:01 server systemd[1]: Started My Application
Sep 14 15:30:01 server /usr/local/bin/myapp[1234]: Application started

# è®¾ç½®äº†SyslogIdentifierçš„æƒ…å†µ  
$ journalctl -f
Sep 14 15:30:01 server systemd[1]: Started My Application
Sep 14 15:30:01 server myapp[1234]: Application started  # æ¸…æ™°çš„æ ‡è¯†
```

**ğŸ’¡ å®ç”¨æŠ€å·§**ï¼š
```ini
# æ¨èçš„å‘½åè§„èŒƒ
SyslogIdentifier=é¡¹ç›®å-æœåŠ¡å    # å¦‚ï¼šwebapp-api
SyslogIdentifier=å…¬å¸-åº”ç”¨       # å¦‚ï¼šacme-billing  
SyslogIdentifier=ç¯å¢ƒ-æœåŠ¡       # å¦‚ï¼šprod-database
```

---

## 3. ğŸ·ï¸ æ—¥å¿—å­—æ®µæ ‡å‡†åŒ–


### 3.1 æ ¸å¿ƒæ—¥å¿—å­—æ®µè§£æ


**ğŸ“‹ é‡è¦å­—æ®µè¯´æ˜**ï¼š

```bash
# æŸ¥çœ‹å®Œæ•´çš„æ—¥å¿—å­—æ®µ
$ journalctl -o verbose -n 1

# å¸¸è§çš„é‡è¦å­—æ®µ
PRIORITY=6                    # æ—¥å¿—çº§åˆ«ï¼ˆ0-7ï¼Œæ•°å­—è¶Šå°è¶Šé‡è¦ï¼‰
SYSLOG_IDENTIFIER=myapp      # æœåŠ¡æ ‡è¯†ç¬¦
_SYSTEMD_UNIT=myapp.service  # systemdå•å…ƒåç§°
MESSAGE=å®é™…çš„æ—¥å¿—å†…å®¹         # ç¨‹åºè¾“å‡ºçš„æ¶ˆæ¯
_PID=1234                    # è¿›ç¨‹ID
_HOSTNAME=myserver           # ä¸»æœºå
__REALTIME_TIMESTAMP=...     # ç²¾ç¡®æ—¶é—´æˆ³
```

### 3.2 PRIORITYä¼˜å…ˆçº§è¯¦è§£


**ğŸš¦ æ—¥å¿—çº§åˆ«å¯¹ç…§è¡¨**ï¼š

| çº§åˆ« | **åç§°** | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** |
|-----|---------|---------|-------------|
| `0` | `emerg` | `ç³»ç»Ÿä¸å¯ç”¨` | `ç³»ç»Ÿå´©æºƒ` |
| `1` | `alert` | `éœ€è¦ç«‹å³å¤„ç†` | `æ•°æ®åº“è¿æ¥å¤±è´¥` |
| `2` | `crit` | `ä¸¥é‡é”™è¯¯` | `ç£ç›˜ç©ºé—´ä¸è¶³` |
| `3` | `err` | `ä¸€èˆ¬é”™è¯¯` | `æ–‡ä»¶æ‰¾ä¸åˆ°` |
| `4` | `warning` | `è­¦å‘Šä¿¡æ¯` | `é…ç½®é¡¹ç¼ºå¤±` |
| `5` | `notice` | `é‡è¦ä¿¡æ¯` | `æœåŠ¡å¯åŠ¨æˆåŠŸ` |
| `6` | `info` | `æ™®é€šä¿¡æ¯` | `ç”¨æˆ·ç™»å½•` |
| `7` | `debug` | `è°ƒè¯•ä¿¡æ¯` | `ç¨‹åºæ‰§è¡Œæµç¨‹` |

**å®é™…ä½¿ç”¨æŠ€å·§**ï¼š
```bash
# åªæŸ¥çœ‹é”™è¯¯çº§åˆ«åŠä»¥ä¸Šçš„æ—¥å¿—ï¼ˆ0-3çº§ï¼‰
$ journalctl --priority=err

# æŸ¥çœ‹ç‰¹å®šçº§åˆ«çš„æ—¥å¿—
$ journalctl --priority=warning..err  # warningåˆ°errorä¹‹é—´

# æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯
$ journalctl --priority=debug -u myapp.service
```

### 3.3 _SYSTEMD_UNITå­—æ®µçš„ä½œç”¨


**ğŸ” ç†è§£systemdå•å…ƒæ ‡è¯†**ï¼š

```bash
# _SYSTEMD_UNITå‘Šè¯‰æˆ‘ä»¬æ—¥å¿—æ¥è‡ªå“ªä¸ªæœåŠ¡
$ journalctl -f | grep "_SYSTEMD_UNIT=nginx.service"

# å®é™…åº”ç”¨ï¼šå¿«é€Ÿå®šä½æœåŠ¡æ—¥å¿—
$ journalctl _SYSTEMD_UNIT=postgresql.service
$ journalctl _SYSTEMD_UNIT=docker.service
```

---

## 4. ğŸ“ ç»“æ„åŒ–æ—¥å¿—è®°å½•æœ€ä½³å®è·µ


### 4.1 ä»€ä¹ˆæ˜¯ç»“æ„åŒ–æ—¥å¿—


**ğŸ¤” ä¼ ç»Ÿæ—¥å¿— vs ç»“æ„åŒ–æ—¥å¿—**ï¼š

```
ä¼ ç»Ÿæ—¥å¿—ï¼ˆéš¾ä»¥è§£æï¼‰ï¼š
2025-09-14 15:30:01 ç”¨æˆ·å¼ ä¸‰ç™»å½•ç³»ç»Ÿï¼ŒIPåœ°å€192.168.1.100ï¼Œæ“ä½œæˆåŠŸ

ç»“æ„åŒ–æ—¥å¿—ï¼ˆæœºå™¨å‹å¥½ï¼‰ï¼š
{
  "timestamp": "2025-09-14T15:30:01Z",
  "level": "info", 
  "user": "å¼ ä¸‰",
  "action": "login",
  "ip": "192.168.1.100",
  "result": "success"
}
```

### 4.2 ç¨‹åºä¸­çš„ç»“æ„åŒ–æ—¥å¿—å®è·µ


**ğŸ Pythonç¤ºä¾‹**ï¼š
```python
import json
import sys
from datetime import datetime

def structured_log(level, message, **extra_fields):
    """è¾“å‡ºç»“æ„åŒ–æ—¥å¿—"""
    log_entry = {
        "timestamp": datetime.utcnow().isoformat() + "Z",
        "level": level,
        "message": message,
        **extra_fields  # é¢å¤–çš„ç»“æ„åŒ–å­—æ®µ
    }
    
    # è¾“å‡ºåˆ°stdoutï¼Œsystemdä¼šè‡ªåŠ¨æ”¶é›†
    print(json.dumps(log_entry, ensure_ascii=False))

# ä½¿ç”¨ç¤ºä¾‹
structured_log("info", "ç”¨æˆ·ç™»å½•", user="å¼ ä¸‰", ip="192.168.1.100")
structured_log("error", "æ•°æ®åº“è¿æ¥å¤±è´¥", database="mysql", retry_count=3)
```

**âš™ï¸ å¯¹åº”çš„systemdæœåŠ¡é…ç½®**ï¼š
```ini
[Service]
StandardOutput=journal
StandardError=journal
SyslogIdentifier=myapp
# journaldä¼šè‡ªåŠ¨è§£æJSONæ ¼å¼çš„æ—¥å¿—
```

### 4.3 journaldä¸­æŸ¥è¯¢ç»“æ„åŒ–æ•°æ®


```bash
# journaldä¼šè‡ªåŠ¨è§£æJSONå­—æ®µ
$ journalctl -u myapp.service -o json-pretty

# æŒ‰ç…§è‡ªå®šä¹‰å­—æ®µè¿‡æ»¤ï¼ˆå¦‚æœç¨‹åºæ”¯æŒï¼‰
$ journalctl -u myapp.service | jq '.USER="å¼ ä¸‰"'

# ç»Ÿè®¡ç‰¹å®šæ“ä½œ
$ journalctl -u myapp.service --since today | grep '"action":"login"' | wc -l
```

---

## 5. ğŸ’¾ æ—¥å¿—æŒä¹…åŒ–é…ç½®


### 5.1 Storageé…ç½®è¯¦è§£


**ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®**ï¼š`/etc/systemd/journald.conf`

```ini
[Journal]
# å­˜å‚¨æ¨¡å¼é…ç½®
Storage=persistent          # æ—¥å¿—æŒä¹…åŒ–å­˜å‚¨

# å…¶ä»–å¸¸ç”¨é€‰é¡¹ï¼š
# Storage=volatile          # åªåœ¨å†…å­˜ä¸­å­˜å‚¨ï¼ˆé‡å¯ä¸¢å¤±ï¼‰
# Storage=auto             # è‡ªåŠ¨é€‰æ‹©ï¼ˆé»˜è®¤å€¼ï¼‰
# Storage=none             # ç¦ç”¨æ—¥å¿—æ”¶é›†
```

**ğŸ”§ ä¸åŒStorageæ¨¡å¼å¯¹æ¯”**ï¼š

| æ¨¡å¼ | **å­˜å‚¨ä½ç½®** | **é‡å¯å** | **é€‚ç”¨åœºæ™¯** |
|-----|------------|------------|-------------|
| `persistent` | `/var/log/journal/` | `ä¿ç•™` | `ç”Ÿäº§ç¯å¢ƒ` |
| `volatile` | `/run/log/journal/` | `ä¸¢å¤±` | `ä¸´æ—¶è°ƒè¯•` |
| `auto` | `è‡ªåŠ¨åˆ¤æ–­` | `çœ‹æƒ…å†µ` | `ä¸€èˆ¬ä½¿ç”¨` |
| `none` | `ä¸å­˜å‚¨` | `æ— æ—¥å¿—` | `æç®€ç³»ç»Ÿ` |

### 5.2 SystemMaxUseç©ºé—´æ§åˆ¶


**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç©ºé—´æ§åˆ¶ï¼Ÿ**
æƒ³è±¡ä¸€ä¸‹ï¼šå¦‚æœç¨‹åºç–¯ç‹‚è¾“å‡ºæ—¥å¿—ï¼Œå¾ˆå¿«å°±ä¼šæŠŠç¡¬ç›˜å æ»¡ï¼

```ini
[Journal]
Storage=persistent

# ç£ç›˜ç©ºé—´æ§åˆ¶
SystemMaxUse=1G            # æœ€å¤šå ç”¨1GBç£ç›˜ç©ºé—´
SystemKeepFree=500M        # è‡³å°‘ä¿ç•™500MBç©ºé—²ç©ºé—´
SystemMaxFileSize=100M     # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§100MB

# å†…å­˜ç©ºé—´æ§åˆ¶ï¼ˆvolatileæ¨¡å¼ï¼‰
RuntimeMaxUse=100M         # å†…å­˜ä¸­æœ€å¤š100MB
RuntimeKeepFree=50M        # å†…å­˜è‡³å°‘ä¿ç•™50MB
```

**ğŸ“Š ç©ºé—´ç®¡ç†ç­–ç•¥**ï¼š
```bash
# æŸ¥çœ‹å½“å‰æ—¥å¿—å ç”¨ç©ºé—´
$ journalctl --disk-usage
Archived and active journals take up 156.0M in the file system.

# æŸ¥çœ‹è¯¦ç»†çš„æ—¥å¿—æ–‡ä»¶
$ ls -lh /var/log/journal/æœºå™¨ID/
-rw-r-----. 1 root systemd-journal  33M Sep 10 10:00 system.journal
-rw-r-----. 1 root systemd-journal  67M Sep 14 15:30 system.journal~

# æ‰‹åŠ¨æ¸…ç†æ—§æ—¥å¿—
$ journalctl --vacuum-time=7d    # ä¿ç•™7å¤©
$ journalctl --vacuum-size=500M  # ä¿ç•™500MB
```

### 5.3 æ—¥å¿—è½®è½¬é…ç½®


```ini
[Journal]
# æ—¶é—´è½®è½¬è®¾ç½®
MaxRetentionSec=1month     # æ—¥å¿—ä¿ç•™1ä¸ªæœˆ
MaxFileSec=1day           # æ¯å¤©åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶

# æ–‡ä»¶æ•°é‡æ§åˆ¶  
SystemMaxFiles=100        # æœ€å¤šä¿ç•™100ä¸ªæ—¥å¿—æ–‡ä»¶
```

**ğŸ”„ å®é™…è½®è½¬ç¤ºä¾‹**ï¼š
```
/var/log/journal/æœºå™¨ID/
â”œâ”€â”€ system.journal           # å½“å‰æ´»åŠ¨æ—¥å¿—
â”œâ”€â”€ system@0005d1234.journal # å†å²æ—¥å¿—1
â”œâ”€â”€ system@0005d1235.journal # å†å²æ—¥å¿—2
â””â”€â”€ user-1000@0005d1236.journal # ç”¨æˆ·æ—¥å¿—
```

---

## 6. ğŸ” æœåŠ¡æ—¥å¿—æŸ¥è¯¢æŠ€å·§


### 6.1 åŸºç¡€æŸ¥è¯¢å‘½ä»¤


**journalctl -uï¼ˆå•å…ƒæŸ¥è¯¢ï¼‰**ï¼š
```bash
# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ‰€æœ‰æ—¥å¿—
$ journalctl -u nginx.service

# æŸ¥çœ‹å¤šä¸ªæœåŠ¡çš„æ—¥å¿—
$ journalctl -u nginx.service -u mysql.service

# å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆç±»ä¼¼tail -fï¼‰
$ journalctl -u myapp.service -f
```

### 6.2 æ—¶é—´èŒƒå›´æŸ¥è¯¢æŠ€å·§


**--sinceå‚æ•°çš„å¼ºå¤§åŠŸèƒ½**ï¼š
```bash
# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
$ journalctl -u myapp.service --since today

# æŸ¥çœ‹æœ€è¿‘1å°æ—¶
$ journalctl -u myapp.service --since "1 hour ago"

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µ
$ journalctl -u myapp.service --since "2025-09-14 10:00:00" --until "2025-09-14 15:00:00"

# æŸ¥çœ‹æœ€è¿‘çš„å¯åŠ¨æ—¥å¿—
$ journalctl -u myapp.service --since "$(systemctl show -p ActiveEnterTimestamp myapp.service | cut -d= -f2)"
```

**ğŸ“… æ—¶é—´æ ¼å¼æ”¯æŒ**ï¼š
- `"10 minutes ago"`
- `"yesterday"`  
- `"2025-09-14"`
- `"2025-09-14 15:30:00"`
- `"15:30:00"`

### 6.3 é«˜çº§æŸ¥è¯¢æŠ€å·§


**ğŸ¯ ç»„åˆæŸ¥è¯¢ç¤ºä¾‹**ï¼š
```bash
# æŸ¥çœ‹é”™è¯¯çº§åˆ«çš„æ—¥å¿—
$ journalctl -u myapp.service --priority=err --since today

# æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„æ—¥å¿—
$ journalctl _PID=1234

# æŸ¥çœ‹æ¥è‡ªç‰¹å®šç”¨æˆ·çš„æ—¥å¿—  
$ journalctl _UID=1000

# æŒ‰ç…§æ—¥å¿—æ ‡è¯†ç¬¦æŸ¥è¯¢
$ journalctl SYSLOG_IDENTIFIER=myapp

# æŸ¥çœ‹å†…æ ¸æ¶ˆæ¯
$ journalctl -k --since "1 hour ago"
```

**ğŸ”§ è¾“å‡ºæ ¼å¼æ§åˆ¶**ï¼š
```bash
# JSONæ ¼å¼ï¼ˆä¾¿äºç¨‹åºå¤„ç†ï¼‰
$ journalctl -u myapp.service -o json

# è¯¦ç»†æ ¼å¼ï¼ˆæ˜¾ç¤ºæ‰€æœ‰å­—æ®µï¼‰
$ journalctl -u myapp.service -o verbose

# ç®€çŸ­æ ¼å¼ï¼ˆç±»ä¼¼ä¼ ç»Ÿsyslogï¼‰
$ journalctl -u myapp.service -o short-iso

# åªæ˜¾ç¤ºæ¶ˆæ¯å†…å®¹
$ journalctl -u myapp.service -o cat
```

### 6.4 å®ç”¨æŸ¥è¯¢è„šæœ¬


**ğŸ“œ å¸¸ç”¨æŸ¥è¯¢è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æœåŠ¡æ—¥å¿—åˆ†æè„šæœ¬

SERVICE_NAME="$1"

if [ -z "$SERVICE_NAME" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <æœåŠ¡å>"
    exit 1
fi

echo "=== æœåŠ¡çŠ¶æ€ ==="
systemctl status "$SERVICE_NAME"

echo -e "\n=== ä»Šå¤©çš„é”™è¯¯æ—¥å¿— ==="
journalctl -u "$SERVICE_NAME" --priority=err --since today --no-pager

echo -e "\n=== æœ€è¿‘10æ¡æ—¥å¿— ==="
journalctl -u "$SERVICE_NAME" -n 10 --no-pager

echo -e "\n=== æ—¥å¿—ç»Ÿè®¡ ==="
echo "æ€»æ—¥å¿—æ¡æ•°: $(journalctl -u "$SERVICE_NAME" --since today | wc -l)"
echo "é”™è¯¯æ—¥å¿—æ¡æ•°: $(journalctl -u "$SERVICE_NAME" --priority=err --since today | wc -l)"
```

---

## 7. ğŸŒ æ—¥å¿—è½¬å‘ä¸é›†æˆ


### 7.1 è½¬å‘åˆ°è¿œç¨‹syslogæœåŠ¡å™¨


**ğŸ”„ ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—è½¬å‘ï¼Ÿ**
- **é›†ä¸­ç®¡ç†**ï¼šå¤šå°æœåŠ¡å™¨çš„æ—¥å¿—é›†ä¸­åˆ°ä¸€å¤„
- **å®‰å…¨å¤‡ä»½**ï¼šæœ¬åœ°æ—¥å¿—è¢«åˆ é™¤æ—¶è¿˜æœ‰å¤‡ä»½
- **åˆè§„è¦æ±‚**ï¼šæŸäº›è¡Œä¸šè¦æ±‚æ—¥å¿—é›†ä¸­å­˜å‚¨

**âš™ï¸ rsyslogé›†æˆé…ç½®**ï¼š

```bash
# 1. å®‰è£…rsyslog
$ sudo apt install rsyslog

# 2. é…ç½®rsyslogè½¬å‘ (/etc/rsyslog.d/99-forward.conf)
*.*  $$log-server.company.com:514
```

**ğŸ”§ systemdæœåŠ¡é…ç½®è½¬å‘**ï¼š
```ini
[Service]
StandardOutput=journal
StandardError=journal
SyslogIdentifier=myapp

# journaldä¼šè‡ªåŠ¨è½¬å‘ç»™rsyslog
```

### 7.2 ä¸ELK Stacké›†æˆ


**ğŸ“Š å®Œæ•´çš„æ—¥å¿—å¤„ç†æµç¨‹**ï¼š
```
[åº”ç”¨] â†’ [journald] â†’ [filebeat] â†’ [elasticsearch] â†’ [kibana]
   â†“         â†“           â†“            â†“              â†“
ç¨‹åºæ—¥å¿—   æœ¬åœ°æ”¶é›†    æ—¥å¿—é‡‡é›†      æœç´¢å­˜å‚¨      å¯è§†åŒ–ç•Œé¢
```

**ğŸ”§ Filebeaté…ç½®ç¤ºä¾‹**ï¼š
```yaml
# /etc/filebeat/filebeat.yml
filebeat.inputs:
- type: journald
  id: systemd-services
  include_matches:
    - "_SYSTEMD_UNIT=myapp.service"
    - "_SYSTEMD_UNIT=nginx.service"

output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  index: "systemd-logs-%{+yyyy.MM.dd}"

processors:
- add_host_metadata:
    when.not.contains.tags: forwarded
```

### 7.3 æ—¥å¿—èšåˆæœ€ä½³å®è·µ


**ğŸ¯ å¤šæœåŠ¡å™¨æ—¥å¿—ç®¡ç†ç­–ç•¥**ï¼š

```bash
# æ¯å°æœåŠ¡å™¨çš„journaldé…ç½®
[Journal]
Storage=persistent
ForwardToSyslog=yes        # è½¬å‘ç»™syslog
SystemMaxUse=500M          # æœ¬åœ°ä¿ç•™500MB

# ä¸­å¤®æ—¥å¿—æœåŠ¡å™¨é…ç½®
[Journal]  
Storage=persistent
SystemMaxUse=10G           # ä¸­å¤®æœåŠ¡å™¨ä¿ç•™æ›´å¤š
MaxRetentionSec=3month     # ä¿ç•™3ä¸ªæœˆ
```

**ğŸ“‹ æ—¥å¿—æ ‡å‡†åŒ–è§„èŒƒ**ï¼š
```ini
# ç»Ÿä¸€çš„æœåŠ¡é…ç½®æ¨¡æ¿
[Service]
StandardOutput=journal
StandardError=journal
SyslogIdentifier=${PROJECT}-${SERVICE}-${ENV}
# ä¾‹å¦‚ï¼šwebapp-api-prod, webapp-db-test
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ journaldé›†æˆï¼šsystemdè‡ªåŠ¨æ”¶é›†æ‰€æœ‰æœåŠ¡æ—¥å¿—åˆ°ç»Ÿä¸€å­˜å‚¨
ğŸ”¸ æœåŠ¡æ—¥å¿—é…ç½®ï¼šStandardOutputã€StandardErrorã€SyslogIdentifier
ğŸ”¸ ç»“æ„åŒ–å­—æ®µï¼šPRIORITYã€_SYSTEMD_UNITã€MESSAGEç­‰æ ‡å‡†å­—æ®µ
ğŸ”¸ æŒä¹…åŒ–é…ç½®ï¼šStorageã€SystemMaxUseæ§åˆ¶æ—¥å¿—å­˜å‚¨
ğŸ”¸ æŸ¥è¯¢æŠ€å·§ï¼šjournalctl -uã€-fã€--sinceç­‰å¸¸ç”¨å‚æ•°
ğŸ”¸ æ—¥å¿—è½¬å‘ï¼šä¸ä¼ ç»Ÿsyslogå’Œç°ä»£æ—¥å¿—æ ˆçš„é›†æˆ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆé€‰æ‹©journaldï¼Ÿ**
```
ä¼ ç»Ÿé—®é¢˜ï¼š
- æ—¥å¿—åˆ†æ•£åœ¨å„ä¸ªæ–‡ä»¶ä¸­ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†
- æ–‡æœ¬æ ¼å¼æŸ¥è¯¢æ€§èƒ½å·®
- æ‰‹åŠ¨é…ç½®è½®è½¬å®¹æ˜“å‡ºé”™

journaldä¼˜åŠ¿ï¼š
- è‡ªåŠ¨æ”¶é›†æ‰€æœ‰systemdæœåŠ¡æ—¥å¿—
- äºŒè¿›åˆ¶å­˜å‚¨ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«
- è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤
- ç»“æ„åŒ–æ•°æ®ï¼Œä¾¿äºåˆ†æ
```

**ğŸ”¹ æ—¥å¿—é…ç½®çš„æœ€ä½³å®è·µ**
```
æœåŠ¡é…ç½®åŸåˆ™ï¼š
âœ… æ€»æ˜¯è®¾ç½®SyslogIdentifierï¼Œä¾¿äºè¯†åˆ«
âœ… StandardOutputå’ŒStandardErroréƒ½è®¾ä¸ºjournal
âœ… ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æ ¼å¼ï¼ˆJSONï¼‰
âœ… æ ¹æ®é‡è¦æ€§è®¾ç½®åˆé€‚çš„æ—¥å¿—çº§åˆ«

å­˜å‚¨é…ç½®åŸåˆ™ï¼š
âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨Storage=persistent
âœ… è®¾ç½®åˆç†çš„SystemMaxUseé¿å…ç£ç›˜çˆ†æ»¡
âœ… å®šæœŸæ¸…ç†æ—§æ—¥å¿—ä¿æŒç³»ç»Ÿå¥åº·
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ—¥å¸¸è¿ç»´åœºæ™¯**ï¼š

```bash
# åœºæ™¯1ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥æ’æŸ¥
$ systemctl status myapp.service          # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
$ journalctl -u myapp.service --since "5 minutes ago"  # æŸ¥çœ‹æœ€è¿‘æ—¥å¿—

# åœºæ™¯2ï¼šæ€§èƒ½é—®é¢˜åˆ†æ
$ journalctl -u myapp.service --priority=warning --since today  # æŸ¥çœ‹è­¦å‘Šä»¥ä¸Šæ—¥å¿—

# åœºæ™¯3ï¼šæ—¥å¿—ç©ºé—´ç®¡ç†
$ journalctl --disk-usage                  # æ£€æŸ¥ç©ºé—´å ç”¨
$ journalctl --vacuum-time=30d             # æ¸…ç†30å¤©å‰æ—¥å¿—

# åœºæ™¯4ï¼šæœåŠ¡ç›‘æ§è„šæœ¬
$ journalctl -u myapp.service -f | grep -i error  # å®æ—¶ç›‘æ§é”™è¯¯
```

**âš¡ è®°å¿†è¦ç‚¹**ï¼š
- **journald = systemdçš„æ—¥å¿—ç®¡å®¶**ï¼Œè‡ªåŠ¨æ”¶é›†ç®¡ç†
- **StandardOutput=journal** æ˜¯æœåŠ¡æ—¥å¿—é…ç½®çš„æ ‡å‡†åšæ³•
- **SyslogIdentifier** è®©ä½ çš„æœåŠ¡æ—¥å¿—æœ‰æ¸…æ™°çš„æ ‡è¯†
- **journalctl -u æœåŠ¡å** æ˜¯æŸ¥çœ‹æœåŠ¡æ—¥å¿—çš„åŸºæœ¬å‘½ä»¤
- **ç»“æ„åŒ–æ—¥å¿—** è®©æœºå™¨å’Œäººéƒ½å®¹æ˜“ç†è§£æ—¥å¿—å†…å®¹

### 8.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


| é—®é¢˜ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|------|------------|------------|
| `æ—¥å¿—ä¸¢å¤±` | `Storage=volatile` | `æ”¹ä¸ºStorage=persistent` |
| `ç£ç›˜ç©ºé—´ä¸è¶³` | `SystemMaxUseæœªé™åˆ¶` | `è®¾ç½®åˆç†çš„ç©ºé—´é™åˆ¶` |
| `æ—¥å¿—æŸ¥è¯¢æ…¢` | `æ—¶é—´èŒƒå›´å¤ªå¤§` | `ä½¿ç”¨--sinceç¼©å°èŒƒå›´` |
| `æ— æ³•è¯†åˆ«æœåŠ¡æ—¥å¿—` | `ç¼ºå°‘SyslogIdentifier` | `æ·»åŠ æ ‡è¯†ç¬¦é…ç½®` |

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- journaldæ”¶é›†æ—¥å¿—å¾ˆèªæ˜ï¼ŒsystemdæœåŠ¡å…¨è‡ªåŠ¨
- StandardOutputè®¾ä¸ºjournalï¼ŒSyslogIdentifieråˆ«å¿˜è®°
- æŒä¹…å­˜å‚¨é…ç½®å¥½ï¼Œç©ºé—´å¤§å°è¦æ§åˆ¶
- journalctlæŸ¥è¯¢å¼ºï¼Œæ—¶é—´èŒƒå›´åŠ æœåŠ¡å