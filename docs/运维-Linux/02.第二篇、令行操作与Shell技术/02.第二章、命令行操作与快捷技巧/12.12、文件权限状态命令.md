---
title: 12、文件权限状态命令
---
## 📚 目录

1. [文件权限基础概念](#1-文件权限基础概念)
2. [chmod权限修改命令](#2-chmod权限修改命令)
3. [chown所有者修改命令](#3-chown所有者修改命令)
4. [chgrp组修改命令](#4-chgrp组修改命令)
5. [umask默认权限掩码](#5-umask默认权限掩码)
6. [扩展属性管理命令](#6-扩展属性管理命令)
7. [ACL权限管理](#7-ACL权限管理)
8. [用户切换与权限提升](#8-用户切换与权限提升)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🔐 文件权限基础概念


### 1.1 什么是文件权限


**🔸 权限的作用**
```
文件权限就像房子的门锁和钥匙：
- 决定谁能进入房子（读取文件）
- 决定谁能整理房子（修改文件）
- 决定谁能使用房子里的工具（执行文件）

Linux中每个文件都有三套权限：
• 所有者权限：文件主人的权限
• 组权限：文件所属组成员的权限
• 其他人权限：除所有者和组成员外所有人的权限
```

### 1.2 权限的表示方法


**📊 权限符号表示**
```
使用 ls -l 查看文件权限：
-rw-r--r-- 1 user group 1024 Sep 13 15:30 file.txt
 ↑↑↑ ↑↑↑ ↑↑↑
 │││ │││ │││
 │││ │││ └──── 其他人权限（r--：只读）
 │││ └────── 组权限（r--：只读）
 └────── 所有者权限（rw-：读写）

权限字符含义：
r (read)：读权限，可以查看文件内容
w (write)：写权限，可以修改文件内容
x (execute)：执行权限，可以运行文件
- ：没有对应权限
```

**🔢 权限数字表示**
```
每种权限用数字表示：
r = 4 (读权限)
w = 2 (写权限)  
x = 1 (执行权限)

计算方法：
rwx = 4+2+1 = 7 (所有权限)
rw- = 4+2+0 = 6 (读写权限)
r-x = 4+0+1 = 5 (读执行权限)
r-- = 4+0+0 = 4 (只读权限)

完整权限示例：
755 = rwxr-xr-x (所有者：读写执行，组和其他：读执行)
644 = rw-r--r-- (所有者：读写，组和其他：只读)
```

### 1.3 目录权限的特殊含义


**📁 目录权限理解**
```
对于目录来说，权限含义不同：

r (读权限)：
• 可以查看目录内容（ls命令）
• 就像能看到房间里有什么东西

w (写权限)：
• 可以在目录中创建、删除文件
• 就像能往房间里放东西或拿走东西

x (执行权限)：
• 可以进入目录（cd命令）
• 就像能进入房间
• 没有x权限就无法访问目录内的文件！

实际例子：
目录权限是 r-- ：只能看到目录内容，但进不去
目录权限是 --x ：看不到目录内容，但知道文件名就能进去
目录权限是 rwx ：完全权限，随意操作
```

---

## 2. ⚙️ chmod权限修改命令


### 2.1 chmod基本概念


**🔸 命令作用**
```
chmod = change mode（修改模式）
作用：修改文件或目录的权限
格式：chmod [选项] 权限设置 文件名

就像换门锁：
- 原来的锁只有主人能开
- 换锁后可以让更多人有钥匙
- 或者让某些人没有钥匙
```

### 2.2 数字模式设置权限


**🔢 数字模式语法**
```bash
# 基本格式
chmod 权限数字 文件名

# 常用权限设置
chmod 755 script.sh    # 脚本文件：所有者全权限，其他只读执行
chmod 644 data.txt     # 文本文件：所有者读写，其他只读
chmod 600 secret.txt   # 机密文件：只有所有者能读写
chmod 777 temp/        # 临时目录：所有人全权限（谨慎使用！）
```

**💡 常用权限数字记忆**
```
┌─ 文件权限速查表 ───────────────┐
│ 755：程序文件（可执行）        │
│ 644：文档文件（普通文件）      │
│ 600：私密文件（个人文档）      │
│ 700：私密目录（个人目录）      │
│ 755：共享目录（公共访问）      │
│ 777：临时目录（完全开放）      │
└────────────────────────────────┘

记忆技巧：
• 6开头：文件权限（644最常见）
• 7开头：目录权限或可执行文件（755最常见）
• 数字越大权限越多
```

### 2.3 符号模式设置权限


**🔤 符号模式语法**
```bash
# 基本格式
chmod [用户][操作][权限] 文件名

用户符号：
u = user（所有者）
g = group（组）
o = other（其他人）
a = all（所有人）

操作符号：
+ = 添加权限
- = 移除权限
= = 设置精确权限

权限符号：
r = 读权限
w = 写权限
x = 执行权限
```

**📝 符号模式实例**
```bash
# 给所有者添加执行权限
chmod u+x script.sh

# 给组和其他人移除写权限
chmod go-w file.txt

# 给所有人添加读权限
chmod a+r readme.txt

# 设置所有者为读写执行，其他人只读
chmod u=rwx,go=r important.sh

# 给目录及其所有内容添加执行权限
chmod -R a+x project/

# 只给所有者权限，其他人无权限
chmod go= private.txt
```

### 2.4 chmod常用选项


**🛠️ 重要选项**
```bash
# -R：递归修改（目录及其所有内容）
chmod -R 755 website/

# -v：显示详细信息
chmod -v 644 *.txt

# -c：只显示发生改变的文件
chmod -c 755 *.sh

# --reference：参考其他文件的权限
chmod --reference=model.txt target.txt
```

---

## 3. 👤 chown所有者修改命令


### 3.1 chown基本概念


**🔸 命令作用**
```
chown = change owner（修改所有者）
作用：修改文件或目录的所有者和所属组
格式：chown [选项] [用户][:组] 文件名

就像房产过户：
- 原来房子属于张三
- 过户后房子属于李四
- 可以同时改变房子所属的家庭
```

### 3.2 chown使用方法


**👥 基本用法**
```bash
# 只改变所有者
chown alice file.txt                    # 文件归alice所有

# 同时改变所有者和组
chown alice:developers file.txt         # 文件归alice所有，属于developers组

# 只改变组（注意冒号前没有用户名）
chown :developers file.txt              # 只改变组，所有者不变

# 使用数字ID（用户ID和组ID）
chown 1001:1001 file.txt                # 使用UID和GID

# 递归修改目录
chown -R alice:developers project/      # 修改目录及其所有内容
```

**🔍 查找用户和组信息**
```bash
# 查看当前用户信息
id                          # 显示当前用户的UID、GID等信息
id alice                    # 显示alice用户的信息

# 查看所有用户
cat /etc/passwd | head -5   # 查看用户列表

# 查看所有组
cat /etc/group | head -5    # 查看组列表

# 查看文件当前的所有者和组
ls -l file.txt             # 详细显示文件信息
stat file.txt              # 显示文件详细状态
```

### 3.3 chown实际应用场景


**💼 常见使用场景**
```bash
# 场景1：网站文件权限设置
# 让nginx用户拥有网站文件，便于服务器访问
chown -R nginx:nginx /var/www/html/

# 场景2：数据库文件权限
# MySQL数据文件需要mysql用户权限
chown -R mysql:mysql /var/lib/mysql/

# 场景3：用户目录迁移
# 新建用户后，复制文件需要修改所有者
cp -R /home/olduser/documents /home/newuser/
chown -R newuser:newuser /home/newuser/documents

# 场景4：共享项目文件
# 让团队成员都能修改项目文件
chown -R :developers /opt/project/
chmod -R g+w /opt/project/
```

---

## 4. 👥 chgrp组修改命令


### 4.1 chgrp基本概念


**🔸 命令作用**
```
chgrp = change group（修改组）
作用：只修改文件或目录的所属组
格式：chgrp [选项] 组名 文件名

相当于换部门：
- 员工（文件）还是同一个人
- 但是从销售部门（原组）调到技术部门（新组）
- 部门不同，权限也不同
```

### 4.2 chgrp使用方法


**🏢 基本用法**
```bash
# 修改文件的组
chgrp developers file.txt               # 文件属于developers组

# 递归修改目录的组
chgrp -R admin /etc/myapp/              # 目录及所有内容属于admin组

# 使用组ID
chgrp 1002 file.txt                     # 使用GID修改组

# 参考其他文件的组
chgrp --reference=model.txt target.txt  # target.txt的组改为和model.txt一样

# 显示修改过程
chgrp -v staff *.txt                    # 显示详细修改信息
```

**🔄 chgrp vs chown对比**
```
场景选择：

使用chgrp：
• 只需要修改组，所有者不变
• 批量修改多个文件的组
• 脚本中简化操作

使用chown：
• 需要同时修改所有者和组
• 需要更灵活的控制
• 一条命令完成所有修改

实例对比：
chgrp developers file.txt        # 只改组
chown :developers file.txt       # 只改组（效果相同）
chown alice:developers file.txt  # 同时改所有者和组（chgrp做不到）
```

---

## 5. 🎭 umask默认权限掩码


### 5.1 umask基本概念


**🔸 什么是umask**
```
umask = user mask（用户掩码）
作用：设置新建文件和目录的默认权限
原理：从最大权限中减去umask值

就像默认的安全设置：
- 新房子建好后，默认安装什么样的锁
- 不同的人可能有不同的安全习惯
- 有人喜欢更严格，有人喜欢更开放
```

### 5.2 umask计算方法


**🧮 权限计算规则**
```
文件默认最大权限：666（rw-rw-rw-）
目录默认最大权限：777（rwxrwxrwx）

计算公式：
实际权限 = 最大权限 - umask值

例如，umask为022：
新文件权限 = 666 - 022 = 644 (rw-r--r--)
新目录权限 = 777 - 022 = 755 (rwxr-xr-x)

umask为077：
新文件权限 = 666 - 077 = 600 (rw-------)
新目录权限 = 777 - 077 = 700 (rwx------)
```

**📊 常见umask值含义**
```
┌─ umask速查表 ──────────────────┐
│ umask  文件权限  目录权限   安全级别 │
│ 022    644      755      普通用户   │
│ 002    664      775      团队协作   │
│ 077    600      700      高安全性   │
│ 000    666      777      完全开放   │
└────────────────────────────────────┘

推荐设置：
• 普通用户：umask 022（平衡安全与便利）
• 团队项目：umask 002（组内成员可写）
• 个人私密：umask 077（只有自己能访问）
```

### 5.3 umask操作命令


**⚙️ umask管理**
```bash
# 查看当前umask值
umask                       # 显示数字形式
umask -S                    # 显示符号形式

# 临时设置umask（当前会话有效）
umask 022                   # 设置为022
umask 077                   # 设置为高安全模式

# 测试效果
mkdir test_dir              # 创建目录测试权限
touch test_file             # 创建文件测试权限
ls -l test_*               # 查看实际权限

# 永久设置umask
echo "umask 022" >> ~/.bashrc    # 添加到用户配置文件
source ~/.bashrc                 # 重新加载配置

# 为特定用户组设置
echo "umask 002" >> /etc/profile  # 系统级设置
```

---

## 6. 🔧 扩展属性管理命令


### 6.1 lsattr和chattr概念


**🔸 扩展属性的作用**
```
扩展属性 = 文件的特殊标记
作用：给文件添加额外的保护机制
特点：即使是root用户也要遵守某些限制

就像给文件贴上特殊标签：
- "只读标签"：文件不能被修改
- "防删标签"：文件不能被删除
- "压缩标签"：文件自动压缩保存
```

### 6.2 lsattr查看扩展属性


**👁️ 查看属性命令**
```bash
# 查看文件扩展属性
lsattr file.txt                    # 显示单个文件属性
lsattr -d directory/                # 显示目录自身属性
lsattr -R /home/user/              # 递归显示目录下所有文件属性
lsattr -a /tmp/                    # 显示所有文件（包括隐藏文件）

# 属性符号含义
lsattr输出示例：
----i-------- file1.txt           # i属性：不可修改
-----a------- file2.txt           # a属性：只能追加
------------- file3.txt           # 没有特殊属性
```

### 6.3 chattr设置扩展属性


**🔒 重要属性设置**
```bash
# i属性：不可修改（immutable）
chattr +i important.txt            # 文件变为只读，root也不能修改
chattr -i important.txt            # 取消只读属性

# a属性：只能追加（append only）
chattr +a log.txt                  # 文件只能追加内容，不能修改原有内容
chattr -a log.txt                  # 取消追加模式

# 实际测试效果
echo "test" > protected.txt        # 创建文件
chattr +i protected.txt            # 设置为不可修改
echo "new" >> protected.txt        # 操作失败！即使是root也不行
rm protected.txt                   # 删除失败！
chattr -i protected.txt            # 必须先取消属性
rm protected.txt                   # 现在可以删除了
```

**💡 扩展属性应用场景**
```bash
# 场景1：保护重要配置文件
chattr +i /etc/passwd              # 防止密码文件被意外修改
chattr +i /boot/grub/grub.cfg      # 保护启动配置

# 场景2：日志文件管理
chattr +a /var/log/messages        # 日志只能追加，不能篡改历史记录

# 场景3：防止误删重要文件
chattr +i backup.tar.gz            # 防止重要备份被删除

# 取消所有扩展属性
chattr -R -aijsu /home/user/data/   # 批量取消多种属性
```

---

## 7. 🎯 ACL权限管理


### 7.1 ACL基本概念


**🔸 什么是ACL**
```
ACL = Access Control List（访问控制列表）
作用：提供比传统权限更细粒度的权限控制
特点：可以为特定用户或组设置特殊权限

传统权限限制：
- 只有所有者、组、其他人三套权限
- 无法为个别用户设置特殊权限

ACL的优势：
- 可以为任何用户设置权限
- 可以为任何组设置权限
- 一个文件可以有多个特殊权限规则
```

### 7.2 getfacl查看ACL权限


**👀 查看ACL权限**
```bash
# 查看文件的ACL权限
getfacl file.txt

# 输出示例解释：
# file: file.txt
# owner: alice                    # 文件所有者
# group: developers               # 文件所属组
user::rw-                        # 所有者权限
user:bob:r--                     # bob用户特殊权限：只读
group::r--                       # 组权限
group:admin:rw-                  # admin组特殊权限：读写
mask::rw-                        # 有效权限掩码
other::---                       # 其他人权限

# 递归查看目录ACL
getfacl -R project/              # 查看目录及其内容的ACL
getfacl -d project/              # 查看目录的默认ACL
```

### 7.3 setfacl设置ACL权限


**⚙️ ACL权限设置**
```bash
# 为特定用户设置权限
setfacl -m u:bob:rw file.txt               # 给bob用户读写权限
setfacl -m u:alice:rwx script.sh           # 给alice用户完全权限

# 为特定组设置权限
setfacl -m g:admin:rw file.txt             # 给admin组读写权限
setfacl -m g:developers:rwx project/       # 给developers组完全权限

# 设置默认ACL（新文件继承）
setfacl -d -m u:bob:rw project/            # 目录下新文件bob都有读写权限
setfacl -d -m g:team:rwx project/          # 目录下新文件team组都有完全权限

# 删除ACL权限
setfacl -x u:bob file.txt                  # 删除bob的特殊权限
setfacl -x g:admin file.txt                # 删除admin组的特殊权限
setfacl -b file.txt                        # 删除所有ACL权限

# 递归设置ACL
setfacl -R -m u:bob:rw project/            # 递归给bob读写权限
```

**💼 ACL实际应用场景**
```bash
# 场景1：项目协作
# 项目目录：所有者alice，组developers
# 需求：bob（非组成员）需要只读权限，charlie需要完全权限

setfacl -m u:bob:r-x /opt/project/         # bob可以读和进入
setfacl -m u:charlie:rwx /opt/project/     # charlie完全权限
setfacl -d -m u:bob:r-x /opt/project/      # 新文件bob也有只读权限

# 场景2：日志文件管理
# 多个服务需要写入同一日志文件
setfacl -m u:apache:rw /var/log/app.log    # apache用户可写
setfacl -m u:nginx:rw /var/log/app.log     # nginx用户可写
setfacl -m u:mysql:rw /var/log/app.log     # mysql用户可写

# 场景3：备份权限管理
setfacl -m u:backup:r /home/*/             # backup用户可读所有用户目录
setfacl -d -m u:backup:r /home/*/          # 新文件backup用户也可读
```

---

## 8. 🚀 用户切换与权限提升


### 8.1 su命令详解


**🔸 su基本概念**
```
su = switch user（切换用户）
作用：切换到其他用户身份
格式：su [选项] [用户名]

就像变身：
- 从普通员工变成经理
- 获得经理的所有权限
- 但需要知道经理的密码
```

**👤 su使用方法**
```bash
# 切换到root用户
su                              # 切换到root（需要root密码）
su -                            # 切换到root并加载完整环境
su - root                       # 明确指定切换到root

# 切换到其他用户
su alice                        # 切换到alice用户
su - alice                      # 切换到alice并加载其环境

# 执行单个命令后返回
su -c "ls /root" -              # 以root身份执行命令后返回
su alice -c "whoami"            # 以alice身份执行命令

# 退出切换的用户
exit                            # 返回原来的用户
```

**🔧 su选项说明**
```
重要选项：

- 或 -l：完整登录
• 加载目标用户的完整环境
• 切换到用户的主目录
• 就像重新登录一样

-c 命令：执行命令
• 执行完指定命令后返回原用户
• 适合临时需要其他用户权限

-m：保持环境
• 不改变环境变量
• 保持当前目录

示例对比：
su alice           # 切换用户但保持当前环境
su - alice         # 完全切换到alice的环境
```

### 8.2 sudo命令详解


**🔸 sudo基本概念**
```
sudo = super user do（超级用户执行）
作用：以其他用户身份执行命令，通常是root
特点：使用自己的密码，不需要知道目标用户密码

就像临时授权：
- 员工需要经理权限时
- 不需要知道经理密码
- 但需要事先得到授权许可
- 执行完就恢复普通权限
```

**⚡ sudo使用方法**
```bash
# 以root身份执行命令
sudo ls /root                   # 查看root目录
sudo apt update                 # 更新软件包（需要root权限）
sudo systemctl restart nginx   # 重启服务

# 以指定用户身份执行
sudo -u alice ls /home/alice    # 以alice身份查看其主目录
sudo -u www-data touch /var/www/test.html  # 以www-data用户创建文件

# 进入root shell
sudo -i                         # 获得root shell（推荐方式）
sudo su -                       # 通过su进入root shell

# 编辑需要root权限的文件
sudo vim /etc/hosts             # 编辑系统文件
sudo nano /etc/nginx/nginx.conf # 编辑配置文件

# 查看sudo权限
sudo -l                         # 查看当前用户可以执行的sudo命令
```

### 8.3 su vs sudo对比


**⚖️ 选择建议**
```
┌─ su vs sudo 对比表 ────────────────────┐
│ 特性         su命令        sudo命令      │
│ 密码要求     目标用户密码   自己密码      │
│ 权限范围     完整用户权限   指定命令权限  │
│ 使用时长     直到exit      单次命令      │
│ 安全性       较低          较高          │
│ 审计跟踪     无            有            │
│ 配置复杂度   简单          需要配置      │
└────────────────────────────────────────┘

使用场景选择：

使用su的场景：
✅ 需要长时间使用管理员权限
✅ 需要完整的用户环境
✅ 简单的个人服务器管理

使用sudo的场景：
✅ 偶尔需要管理员权限
✅ 多用户环境中的权限控制
✅ 需要命令执行记录
✅ 生产环境的安全管理
```

### 8.4 sudo配置管理


**⚙️ sudoers文件配置**
```bash
# 编辑sudo配置文件（必须使用visudo！）
sudo visudo

# 基本配置语法
用户 主机=(运行身份) 命令

# 配置示例：
alice ALL=(ALL:ALL) ALL              # alice可以执行任何命令
bob ALL=(root) /usr/bin/systemctl    # bob只能执行systemctl命令
%admin ALL=(ALL) ALL                 # admin组成员可以执行任何命令
charlie ALL=(ALL) NOPASSWD: ALL     # charlie执行sudo不需要密码

# 实用配置示例：
# 让用户管理特定服务
alice ALL=(root) /bin/systemctl restart nginx, /bin/systemctl reload nginx

# 让用户管理软件包
bob ALL=(root) /usr/bin/apt update, /usr/bin/apt upgrade

# 让用户查看日志
charlie ALL=(root) /usr/bin/tail /var/log/*
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 文件权限：rwx分别表示读、写、执行，针对所有者、组、其他人三类
🔸 chmod：修改文件权限，支持数字模式（755）和符号模式（u+x）
🔸 chown：修改文件所有者和组，格式为用户:组
🔸 umask：设置新文件的默认权限掩码，影响文件创建时的初始权限
🔸 扩展属性：lsattr查看、chattr设置特殊文件属性
🔸 ACL权限：getfacl查看、setfacl设置更细粒度的权限控制
🔸 用户切换：su需要目标用户密码，sudo使用自己密码获得临时权限
```

### 9.2 常用命令速查表


| 命令类型 | **命令** | **作用** | **常用示例** |
|---------|---------|----------|-------------|
| 🔧 **权限修改** | `chmod 755 file` | `修改文件权限` | `chmod +x script.sh` |
| 👤 **所有者修改** | `chown user:group file` | `修改文件所有者` | `chown -R nginx:nginx /var/www` |
| 👥 **组修改** | `chgrp group file` | `修改文件组` | `chgrp developers *.txt` |
| 🎭 **默认权限** | `umask 022` | `设置默认权限掩码` | `umask 077` |
| 🔒 **扩展属性** | `lsattr file` | `查看扩展属性` | `chattr +i important.txt` |
| 🎯 **ACL权限** | `getfacl file` | `查看ACL权限` | `setfacl -m u:bob:rw file` |
| 🚀 **用户切换** | `su - user` | `切换用户` | `sudo command` |

### 9.3 实际应用最佳实践


**🎯 权限设置原则**
```
最小权限原则：
• 只给必要的权限，不给多余的权限
• 定期检查文件权限，清理不合理的设置
• 重要文件使用扩展属性保护

文件权限建议：
• 程序文件：755（所有者可执行，其他人只读执行）
• 配置文件：644（所有者可修改，其他人只读）
• 私密文件：600（只有所有者可访问）
• 目录权限：755（允许其他人进入和查看）

团队协作：
• 使用统一的umask设置
• 合理使用ACL分配特殊权限
• 通过sudo管理管理员权限
```

**🔧 故障排查技巧**
```
权限问题排查步骤：

1. 确认文件权限
ls -l 文件名              # 查看基本权限
getfacl 文件名            # 查看ACL权限
lsattr 文件名             # 查看扩展属性

2. 确认用户身份
whoami                   # 查看当前用户
id                       # 查看用户ID和所属组

3. 测试权限
sudo -u 用户名 ls 文件名   # 以指定用户测试权限

4. 修复权限
chmod 正确权限 文件名      # 修复基本权限
chown 正确所有者 文件名    # 修复所有者
chattr -i 文件名          # 清除扩展属性限制
```

**💡 安全建议**
```
权限安全最佳实践：

日常使用：
• 普通操作使用普通用户账号
• 需要管理员权限时使用sudo
• 避免长时间使用root账号

文件保护：
• 重要配置文件使用chattr +i保护
• 敏感文件设置严格权限（600或700）
• 定期备份重要文件的权限设置

系统安全：
• 合理配置sudo权限，不给不必要的ALL权限
• 使用ACL为特定用户分配最小必要权限
• 定期审计文件权限和用户权限
```

**核心记忆**：
- 文件权限是Linux安全的基础，理解rwx和数字表示法
- chmod修改权限，chown修改所有者，记住常用权限数字
- umask影响新文件默认权限，扩展属性提供额外保护
- ACL提供细粒度权限控制，sudo比su更安全便利
- 权限问题按"查看→确认→测试→修复"的步骤排查