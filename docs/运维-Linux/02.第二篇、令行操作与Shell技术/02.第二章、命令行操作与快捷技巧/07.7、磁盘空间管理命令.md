---
title: 7、磁盘空间管理命令
---
## 📚 目录

1. [磁盘空间管理概述](#1-磁盘空间管理概述)
2. [df命令 - 查看磁盘使用情况](#2-df命令-查看磁盘使用情况)
3. [du命令 - 统计目录占用空间](#3-du命令-统计目录占用空间)
4. [lsblk命令 - 查看块设备信息](#4-lsblk命令-查看块设备信息)
5. [mount/umount命令 - 挂载与卸载](#5-mount-umount命令-挂载与卸载)
6. [fdisk命令 - 磁盘分区管理](#6-fdisk命令-磁盘分区管理)
7. [blkid命令 - 块设备UUID查询](#7-blkid命令-块设备uuid查询)
8. [ncdu命令 - 交互式磁盘分析](#8-ncdu命令-交互式磁盘分析)
9. [实际应用场景与技巧](#9-实际应用场景与技巧)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 💾 磁盘空间管理概述


### 1.1 为什么需要磁盘空间管理


**🤔 日常问题场景**：
- 服务器突然提示"磁盘空间不足"
- 不知道哪个目录占用了太多空间
- 需要清理垃圾文件释放空间
- 挂载新硬盘或USB设备
- 查看系统有哪些存储设备

**💡 磁盘管理的本质**：
```
就像管理你的房间：
🏠 df = 查看每个房间还有多少空间
📦 du = 统计每个箱子占了多少地方  
🗂️ lsblk = 看看有哪些储物柜可用
🔗 mount = 把新柜子搬进房间使用
✂️ fdisk = 给大柜子分隔成小格子
🏷️ blkid = 给每个柜子贴上标签
🔍 ncdu = 用放大镜仔细检查占用情况
```

### 1.2 Linux磁盘管理基础概念


**🔸 核心概念解释**：

**块设备（Block Device）**：
```
简单理解：就是存储设备的Linux叫法
包括：硬盘、SSD、U盘、SD卡等
特点：数据以"块"为单位读写，适合存储文件
```

**文件系统（File System）**：
```
简单理解：给存储空间制定的"整理规则"
常见类型：ext4、xfs、ntfs、fat32
作用：决定文件怎么存放、怎么命名、怎么查找
```

**挂载点（Mount Point）**：
```
简单理解：给存储设备分配一个"门牌号"
例如：/home、/mnt/usb、/media/disk1
作用：告诉系统去哪个路径访问这个设备
```

---

## 2. 📊 df命令 - 查看磁盘使用情况


### 2.1 df命令基本概念


**🔸 df是什么**：
- **全称**：`disk free`（磁盘剩余空间）
- **作用**：显示文件系统的磁盘使用和可用空间
- **类比**：就像查看每个房间的使用情况

### 2.2 df命令常用参数


**⭐⭐⭐ 最重要的参数**：

**`df -h`（人类可读格式）**：
```bash
df -h
```
**输出示例**：
```
文件系统        容量  已用  可用 已用% 挂载点
/dev/sda1        20G  8.5G   11G   44% /
/dev/sda2       100G   45G   50G   48% /home
tmpfs           2.0G     0  2.0G    0% /dev/shm
```

**🧠 输出解释**：
- **文件系统**：存储设备的名称
- **容量**：总共有多少空间
- **已用**：已经使用了多少
- **可用**：还剩多少可以用
- **已用%**：使用的百分比
- **挂载点**：这个设备挂在哪个目录

### 2.3 df命令实用参数详解


**🔥 必须掌握的参数**：

| 参数 | 含义 | 使用场景 | 示例 |
|------|------|----------|------|
| `-h` | 人类可读（GB/MB显示） | **日常必用** | `df -h` |
| `-T` | 显示文件系统类型 | 查看存储格式 | `df -hT` |
| `-i` | 显示inode使用情况 | 文件数量过多时 | `df -hi` |
| `-x` | 排除指定文件系统 | 过滤无关信息 | `df -h -x tmpfs` |

**💡 实际使用技巧**：

**查看根分区使用情况**：
```bash
df -h /
```

**查看特定目录所在分区**：
```bash
df -h /home/user/documents
```

**查看所有磁盘类型**：
```bash
df -hT
```
**输出示例**：
```
文件系统       类型     容量  已用  可用 已用% 挂载点
/dev/sda1      ext4      20G  8.5G   11G   44% /
/dev/sda2      xfs      100G   45G   50G   48% /home
```

### 2.4 df命令常见问题解决


**❗ 常见误区**：

**误区1**：df和du显示的大小不一致
```
原因：df看的是文件系统层面，du看的是文件层面
解决：这是正常的，deleted文件占用空间df能看到，du看不到
```

**误区2**：显示100%但还能写入文件
```
原因：Linux为root用户预留了5%的空间
解决：普通用户无法使用这部分空间，属于正常现象
```

---

## 3. 📁 du命令 - 统计目录占用空间


### 3.1 du命令基本概念


**🔸 du是什么**：
- **全称**：`disk usage`（磁盘使用量）
- **作用**：统计目录或文件占用的磁盘空间
- **类比**：就像拿秤称每个箱子有多重

### 3.2 du命令核心参数


**⭐⭐⭐ 最重要的参数组合**：

**`du -sh`（摘要+人类可读）**：
```bash
du -sh /home/user
# 输出：2.5G    /home/user
```

**`du -h`（显示所有子目录大小）**：
```bash
du -h /var/log
```
**输出示例**：
```
24K     /var/log/apt
156K    /var/log/journal/system
2.1M    /var/log/apache2
45M     /var/log
```

### 3.3 du命令实用技巧


**🔥 实际工作中的常用组合**：

**找出最大的几个目录**：
```bash
du -sh /* | sort -hr | head -10
```
**解释**：
- `du -sh /*`：统计根目录下所有目录大小
- `sort -hr`：按人类可读格式倒序排列
- `head -10`：显示前10个最大的

**查找当前目录下占用空间最多的文件和目录**：
```bash
du -ah . | sort -hr | head -20
```

**只显示大于100M的目录**：
```bash
du -sh * | grep -E "[0-9]+G|[5-9][0-9][0-9]M"
```

### 3.4 du命令参数详解


| 参数 | 含义 | 实际用途 | 示例 |
|------|------|----------|------|
| `-s` | 只显示总计（摘要） | 查看目录总大小 | `du -s /home` |
| `-h` | 人类可读格式 | 显示GB/MB | `du -h /var` |
| `-a` | 显示所有文件和目录 | 详细分析 | `du -ah /tmp` |
| `-d N` | 显示N层深度 | 限制显示层级 | `du -h -d 2 /usr` |
| `-c` | 显示总计 | 查看总占用 | `du -ch /home/*` |

**💡 记忆技巧**：
- `-s` = **S**ummary（摘要）
- `-h` = **H**uman readable（人类可读）
- `-a` = **A**ll（全部文件）
- `-d` = **D**epth（深度）
- `-c` = **C**alculate total（计算总计）

---

## 4. 🗃️ lsblk命令 - 查看块设备信息


### 4.1 lsblk命令基本概念


**🔸 lsblk是什么**：
- **全称**：`list block devices`（列出块设备）
- **作用**：以树状结构显示所有块设备信息
- **类比**：就像查看电脑上插了哪些存储设备

### 4.2 lsblk基本使用


**基础查看命令**：
```bash
lsblk
```

**输出示例**：
```
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0   100G  0 disk 
├─sda1   8:1    0    20G  0 part /
├─sda2   8:2    0     4G  0 part [SWAP]
└─sda3   8:3    0    76G  0 part /home
sdb      8:16   1     8G  0 disk 
└─sdb1   8:17   1     8G  0 part /media/usb
```

**🧠 输出字段解释**：
```
NAME：设备名称（sda=第一块SCSI硬盘）
MAJ:MIN：主设备号:次设备号（内核识别用）
RM：是否可移动（1=可移动，0=固定）
SIZE：设备大小
RO：是否只读（1=只读，0=可写）
TYPE：类型（disk=磁盘，part=分区）
MOUNTPOINT：挂载点（挂载在哪个目录）
```

### 4.3 lsblk实用参数


**🔥 常用参数组合**：

**显示文件系统信息**：
```bash
lsblk -f
```
**输出示例**：
```
NAME   FSTYPE LABEL     UUID                                 MOUNTPOINT
sda                                                           
├─sda1 ext4   root      12345678-1234-1234-1234-123456789abc /
└─sda2 xfs    home      87654321-4321-4321-4321-cba987654321 /home
```

**显示设备权限信息**：
```bash
lsblk -m
```

### 4.4 lsblk实际应用


**🎯 实际使用场景**：

**插入U盘后查看设备**：
```bash
lsblk | grep -E "sd[b-z]"
# 查找新插入的USB设备
```

**查看哪些分区还没挂载**：
```bash
lsblk | grep -v "MOUNTPOINT"
# 没有挂载点的分区
```

---

## 5. 🔗 mount/umount命令 - 挂载与卸载


### 5.1 挂载概念通俗解释


**🔸 什么是挂载**：
```
生活类比：
就像给房子安装新房间：
- 买了新柜子（插入U盘/硬盘）
- 选择房间位置（挂载点目录）
- 搬进房间使用（mount命令）
- 搬走柜子（umount命令）
```

**为什么需要挂载**：
- Linux把所有存储设备都"嫁接"到一个根目录树上
- 不挂载就无法通过文件路径访问设备
- 挂载就是给设备分配一个"门牌地址"

### 5.2 mount命令基本使用


**⭐⭐⭐ 最常用的挂载方式**：

**挂载U盘/移动硬盘**：
```bash
# 1. 先查看设备
lsblk

# 2. 创建挂载点
sudo mkdir /mnt/usb

# 3. 挂载设备
sudo mount /dev/sdb1 /mnt/usb

# 4. 验证挂载
df -h | grep usb
```

**挂载ISO镜像文件**：
```bash
sudo mount -o loop ubuntu.iso /mnt/iso
```

### 5.3 mount命令常用参数


| 参数 | 含义 | 使用场景 | 示例 |
|------|------|----------|------|
| `-t` | 指定文件系统类型 | 非标准格式 | `mount -t ntfs /dev/sdb1 /mnt/win` |
| `-o` | 挂载选项 | 控制权限和行为 | `mount -o ro /dev/sdb1 /mnt/readonly` |
| `-a` | 挂载fstab中所有项 | 系统启动时 | `mount -a` |
| `-v` | 显示详细信息 | 调试问题时 | `mount -v /dev/sdb1 /mnt/usb` |

**🔥 重要的挂载选项（-o参数）**：

```bash
# 只读挂载
mount -o ro /dev/sdb1 /mnt/readonly

# 指定用户权限
mount -o uid=1000,gid=1000 /dev/sdb1 /mnt/usb

# 设置文件权限
mount -o umask=022 /dev/sdb1 /mnt/data
```

### 5.4 umount命令 - 安全卸载


**🔸 umount基本使用**：
```bash
# 通过挂载点卸载
umount /mnt/usb

# 通过设备名卸载
umount /dev/sdb1
```

**❗ 卸载常见问题**：

**"设备忙"无法卸载**：
```bash
# 查看谁在使用这个设备
lsof /mnt/usb

# 强制卸载（谨慎使用）
umount -f /mnt/usb

# 懒惰卸载（等使用完再卸载）
umount -l /mnt/usb
```

### 5.5 永久挂载设置


**🔸 编辑/etc/fstab实现开机自动挂载**：

**查看设备UUID**：
```bash
blkid /dev/sdb1
```

**编辑fstab文件**：
```bash
sudo nano /etc/fstab
```

**添加挂载条目**：
```
UUID=12345678-1234-1234-1234-123456789abc /mnt/data ext4 defaults 0 2
```

**fstab字段解释**：
```
字段1：设备（推荐用UUID）
字段2：挂载点
字段3：文件系统类型
字段4：挂载选项
字段5：备份设置（通常为0）
字段6：检查顺序（根分区为1，其他为2）
```

---

## 6. 💿 fdisk命令 - 磁盘分区管理


### 6.1 fdisk命令基本概念


**🔸 什么是分区**：
```
生活类比：
把一个大仓库分成若干个小房间：
- 整块硬盘 = 大仓库
- 分区 = 小房间
- 每个房间可以有不同用途（存档案、放货物等）
```

**为什么要分区**：
- **数据隔离**：系统文件和用户文件分开
- **性能优化**：不同分区可以有不同文件系统
- **安全性**：一个分区出问题不影响其他分区

### 6.2 fdisk查看磁盘信息


**⭐⭐⭐ 最常用：查看所有磁盘分区**：
```bash
sudo fdisk -l
```

**输出示例**：
```
磁盘 /dev/sda：100 GiB
设备       启动   起始     末尾     扇区  大小 Id 类型
/dev/sda1  *      2048   41943039  41940992   20G 83 Linux
/dev/sda2      41943040  50331647   8388608    4G 82 Linux swap
/dev/sda3      50331648 209715199 159383552   76G 83 Linux
```

**🧠 输出解释**：
- **设备**：分区设备名
- **启动**：*表示启动分区
- **起始/末尾**：分区在硬盘上的位置
- **扇区**：分区大小（以扇区计算）
- **大小**：分区实际大小
- **Id**：分区类型代码
- **类型**：分区用途说明

### 6.3 fdisk交互式分区


**🚨 重要警告**：分区操作会删除数据，务必先备份！

**进入交互模式**：
```bash
sudo fdisk /dev/sdb
```

**fdisk常用交互命令**：
```
Command (m for help): m

常用命令：
p - 显示分区表
n - 新建分区
d - 删除分区
w - 保存并退出
q - 不保存退出
t - 改变分区类型
a - 设置启动标志
```

### 6.4 fdisk实际使用示例


**🎯 给新硬盘创建分区的完整流程**：

**步骤1：查看新硬盘**：
```bash
sudo fdisk -l | grep "GB"
```

**步骤2：对新硬盘分区**：
```bash
sudo fdisk /dev/sdb

# 交互命令序列：
n  # 新建分区
p  # 主分区
1  # 分区编号1
   # 起始扇区（回车使用默认）
   # 结束扇区（回车使用全部空间）
w  # 保存退出
```

**步骤3：格式化分区**：
```bash
sudo mkfs.ext4 /dev/sdb1
```

**步骤4：挂载使用**：
```bash
sudo mkdir /mnt/newdisk
sudo mount /dev/sdb1 /mnt/newdisk
```

---

## 7. 🏷️ blkid命令 - 块设备UUID查询


### 7.1 blkid命令基本概念


**🔸 什么是UUID**：
- **全称**：`Universally Unique Identifier`（全局唯一标识符）
- **作用**：给每个分区分配唯一的身份证号
- **优势**：即使设备名变化，UUID永远不变

**为什么需要UUID**：
```
问题场景：
- 插拔USB设备后，设备名可能变化（sdb变成sdc）
- 添加新硬盘后，原有设备名可能改变
- fstab中使用设备名可能导致挂载失败

解决方案：
- 使用UUID标识设备，永远不会变化
- 即使设备名变了，系统也能找到正确的分区
```

### 7.2 blkid基本使用


**查看所有块设备的UUID**：
```bash
blkid
```

**输出示例**：
```
/dev/sda1: UUID="12345678-1234-1234-1234-123456789abc" TYPE="ext4" PARTUUID="87654321-4321"
/dev/sda2: UUID="87654321-4321-4321-4321-cba987654321" TYPE="swap" PARTUUID="12345678-1234"
/dev/sdb1: LABEL="MyUSB" UUID="abcdefgh-abcd-abcd-abcd-abcdefghijkl" TYPE="vfat"
```

**查看特定设备的信息**：
```bash
blkid /dev/sda1
```

### 7.3 blkid实用参数


| 参数 | 含义 | 使用场景 | 示例 |
|------|------|----------|------|
| `-s` | 指定显示的标签类型 | 只显示特定信息 | `blkid -s UUID /dev/sda1` |
| `-t` | 按条件查找 | 根据属性查找设备 | `blkid -t TYPE=ext4` |
| `-o` | 输出格式 | 脚本中使用 | `blkid -o value -s UUID /dev/sda1` |

### 7.4 blkid实际应用场景


**🎯 常见使用场景**：

**获取设备UUID用于fstab**：
```bash
# 获取UUID
blkid /dev/sdb1

# 用于fstab配置
echo "UUID=$(blkid -s UUID -o value /dev/sdb1) /mnt/data ext4 defaults 0 2" | sudo tee -a /etc/fstab
```

**根据文件系统类型查找设备**：
```bash
# 找出所有ext4分区
blkid -t TYPE=ext4

# 找出所有swap分区
blkid -t TYPE=swap
```

**脚本中获取纯净的UUID值**：
```bash
UUID=$(blkid -s UUID -o value /dev/sdb1)
echo "设备UUID是: $UUID"
```

---

## 8. 🔍 ncdu命令 - 交互式磁盘分析


### 8.1 ncdu命令基本概念


**🔸 ncdu是什么**：
- **全称**：`NCurses Disk Usage`（图形化磁盘使用分析）
- **作用**：交互式显示目录占用空间，可以深入浏览
- **优势**：比du命令更直观，支持实时导航

**🔸 为什么使用ncdu**：
```
传统du命令的问题：
- 输出信息太多，难以阅读
- 无法交互式浏览
- 找到大文件后还要记住路径

ncdu的优势：
- 图形化界面，一目了然
- 可以用键盘导航浏览
- 直接进入占用空间大的目录
- 支持删除文件操作
```

### 8.2 ncdu安装与基本使用


**安装ncdu**：
```bash
# Ubuntu/Debian
sudo apt install ncdu

# CentOS/RHEL
sudo yum install ncdu

# Arch Linux
sudo pacman -S ncdu
```

**基本使用**：
```bash
# 分析当前目录
ncdu

# 分析指定目录
ncdu /home/user

# 分析根目录（需要权限）
sudo ncdu /
```

### 8.3 ncdu交互界面操作


**🔥 ncdu界面操作指南**：

```
界面布局：
┌─────────────────────────────────────┐
│ ncdu 1.15 ~ Use the arrow keys     │
├─────────────────────────────────────┤
│    2.1 GiB [##########] /var/log    │
│    1.8 GiB [########  ] /usr/share  │
│    1.2 GiB [#####     ] /home/user  │
│  456.7 MiB [##        ] /tmp        │
│   89.2 MiB [          ] /opt        │
└─────────────────────────────────────┘

快捷键操作：
↑↓  - 上下移动光标
→   - 进入选中的目录
←   - 返回上级目录
d   - 删除选中的文件/目录
q   - 退出ncdu
?   - 显示帮助信息
```

### 8.4 ncdu高级功能


**🎯 ncdu实用技巧**：

**导出分析结果**：
```bash
# 导出到文件
ncdu -o disk-usage.txt /home/user

# 从文件读取（快速查看之前的分析）
ncdu -f disk-usage.txt
```

**排除特定目录**：
```bash
# 排除proc和sys目录
ncdu --exclude /proc --exclude /sys /
```

**只分析到特定深度**：
```bash
# 只分析2层深度
ncdu --max-depth 2 /
```

---

## 9. 💼 实际应用场景与技巧


### 9.1 服务器磁盘空间告警处理


**🚨 场景：服务器磁盘使用率达到90%**

**处理流程**：
```bash
# 步骤1：快速查看整体情况
df -h

# 步骤2：找出占用空间最大的目录
du -sh /* | sort -hr | head -10

# 步骤3：深入分析问题目录
ncdu /var/log

# 步骤4：清理日志文件
sudo find /var/log -name "*.log" -mtime +7 -delete

# 步骤5：验证清理效果
df -h
```

### 9.2 日常磁盘维护脚本


**🔧 自动化磁盘检查脚本**：
```bash
#!/bin/bash
# 磁盘空间检查脚本

echo "=== 磁盘空间使用情况 ==="
df -h | grep -E "(Filesystem|/dev/)"

echo -e "\n=== 占用空间最大的目录 ==="
du -sh /* 2>/dev/null | sort -hr | head -5

echo -e "\n=== 大文件查找 (>1GB) ==="
find /home -size +1G -type f -exec ls -lh {} \; 2>/dev/null | head -5

echo -e "\n=== 磁盘设备信息 ==="
lsblk -f
```

### 9.3 U盘/移动硬盘使用流程


**🔌 标准U盘操作流程**：

**插入U盘后的操作**：
```bash
# 1. 查看设备
lsblk

# 2. 查看文件系统类型
sudo blkid /dev/sdb1

# 3. 创建挂载点
sudo mkdir /mnt/usb

# 4. 挂载（根据文件系统类型选择）
sudo mount -t vfat /dev/sdb1 /mnt/usb    # FAT32格式
# 或
sudo mount -t ntfs /dev/sdb1 /mnt/usb    # NTFS格式

# 5. 使用完毕后安全卸载
sync  # 同步数据到磁盘
umount /mnt/usb
```

### 9.4 分区扩容实际操作


**📈 场景：/home分区空间不足，需要扩容**

**LVM环境下的扩容**：
```bash
# 1. 查看当前状态
df -h /home
lvdisplay

# 2. 扩展逻辑卷
sudo lvextend -L +10G /dev/vg0/home

# 3. 扩展文件系统
sudo resize2fs /dev/vg0/home  # ext4文件系统
# 或
sudo xfs_growfs /home         # xfs文件系统

# 4. 验证扩容结果
df -h /home
```

### 9.5 磁盘健康监控


**🏥 磁盘健康检查命令**：
```bash
# 安装smartmontools
sudo apt install smartmontools

# 查看磁盘健康状态
sudo smartctl -H /dev/sda

# 查看详细SMART信息
sudo smartctl -a /dev/sda

# 运行短期自检
sudo smartctl -t short /dev/sda
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的命令速查


**🔥 日常必用命令**：
```bash
# 查看磁盘使用情况
df -h

# 查找大文件大目录
du -sh /* | sort -hr | head -10

# 查看所有块设备
lsblk

# 挂载设备
sudo mount /dev/sdb1 /mnt/usb

# 安全卸载
umount /mnt/usb

# 查看分区信息
sudo fdisk -l

# 查看设备UUID
blkid

# 交互式磁盘分析
ncdu
```

### 10.2 命令记忆技巧


**🧠 助记方法**：
```
df = Disk Free (磁盘剩余)
du = Disk Usage (磁盘使用)
lsblk = List Block devices (列出块设备)
mount = 挂载 (就是字面意思)
umount = Unmount (卸载)
fdisk = Fixed Disk (固定磁盘管理)
blkid = Block ID (块设备标识)
ncdu = NCurses Disk Usage (图形化磁盘使用)
```

### 10.3 重要概念理解


**🔸 核心概念总结**：

| 概念 | 简单理解 | 实际作用 |
|------|----------|----------|
| **块设备** | 存储设备的Linux称呼 | 硬盘、U盘等都是块设备 |
| **挂载点** | 设备的访问地址 | 告诉系统去哪找这个设备 |
| **文件系统** | 文件存放的规则 | 决定文件如何组织和存储 |
| **分区** | 把硬盘分成若干部分 | 不同用途的数据分开存储 |
| **UUID** | 设备的身份证号 | 永远不变的设备标识 |

### 10.4 故障排除思路


**🔧 磁盘问题诊断流程**：
```
1. 查看整体情况
   → df -h (看哪个分区满了)
   
2. 定位问题目录  
   → du -sh /* | sort -hr (找大目录)
   
3. 深入分析
   → ncdu 或 du -h 递归查看
   
4. 查看设备状态
   → lsblk (看设备是否正常)
   
5. 检查挂载情况
   → mount | grep 设备名
```

### 10.5 安全使用注意事项


**⚠️ 重要安全提醒**：

```
🚨 危险操作：
- fdisk分区：会删除数据，务必备份
- rm删除大文件：谨慎确认路径
- umount -f强制卸载：可能导致数据丢失

✅ 安全习惯：
- 重要操作前先用-n预览
- 使用UUID而不是设备名
- 卸载前先sync同步数据
- 定期检查磁盘健康状态
```

**💡 最佳实践**：
- 定期清理日志文件和临时文件
- 监控磁盘使用率，及时预警
- 重要数据多重备份
- 使用LVM便于后期扩容

**🎯 学习建议**：
- 先在虚拟机练习分区操作
- 熟练掌握df、du、lsblk三个命令
- 理解挂载的概念和原理
- 学会使用ncdu进行直观分析

---

**🔑 一句话总结**：
> 磁盘管理就是"看空间、找大户、挂设备、分区域"，熟练掌握这八个命令，Linux磁盘管理无忧愁！