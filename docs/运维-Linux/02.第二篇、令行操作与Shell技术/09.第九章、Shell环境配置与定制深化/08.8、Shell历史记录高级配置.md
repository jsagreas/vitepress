---
title: 8ã€Shellå†å²è®°å½•é«˜çº§é…ç½®
---
## ğŸ“š ç›®å½•

1. [Shellå†å²è®°å½•åŸºç¡€æ¦‚å¿µ](#1-Shellå†å²è®°å½•åŸºç¡€æ¦‚å¿µ)
2. [æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£](#2-æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£)
3. [å†å²è®°å½•æ§åˆ¶ç­–ç•¥](#3-å†å²è®°å½•æ§åˆ¶ç­–ç•¥)
4. [å¤šç»ˆç«¯å†å²åŒæ­¥æœºåˆ¶](#4-å¤šç»ˆç«¯å†å²åŒæ­¥æœºåˆ¶)
5. [å†å²è®°å½•å®‰å…¨ä¸æ¸…ç†](#5-å†å²è®°å½•å®‰å…¨ä¸æ¸…ç†)
6. [é«˜çº§å†å²æ“ä½œæŠ€å·§](#6-é«˜çº§å†å²æ“ä½œæŠ€å·§)
7. [å®ç”¨é…ç½®å®æˆ˜](#7-å®ç”¨é…ç½®å®æˆ˜)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš Shellå†å²è®°å½•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Shellå†å²è®°å½•


**ç®€å•ç†è§£**ï¼šShellå†å²è®°å½•å°±åƒæ˜¯ä½ åœ¨å‘½ä»¤è¡Œé‡Œçš„"æ“ä½œè®°å½•æœ¬"

```
æƒ³è±¡ä¸€ä¸‹ï¼š
ä½ åœ¨ç”µè„‘ä¸Šæ‰“å­—èŠå¤©æ—¶ï¼ŒèŠå¤©è½¯ä»¶ä¼šè®°å½•ä½ è¯´è¿‡çš„è¯
Shellå†å²è®°å½•ä¹Ÿæ˜¯ä¸€æ · â†’ è®°å½•ä½ åœ¨ç»ˆç«¯è¾“å…¥è¿‡çš„æ¯ä¸€ä¸ªå‘½ä»¤

ä½œç”¨ï¼š
â€¢ å›é¡¾ä¹‹å‰æ‰§è¡Œè¿‡çš„å‘½ä»¤
â€¢ å¿«é€Ÿé‡å¤æ‰§è¡Œå¤æ‚å‘½ä»¤
â€¢ é¿å…é‡å¤è¾“å…¥é•¿å‘½ä»¤
â€¢ æ’æŸ¥é—®é¢˜æ—¶æŸ¥çœ‹æ“ä½œå†å²
```

### 1.2 å†å²è®°å½•çš„å­˜å‚¨æœºåˆ¶


**å­˜å‚¨ä½ç½®**ï¼š
```bash
# é»˜è®¤å†å²æ–‡ä»¶ä½ç½®
echo $HISTFILE
# é€šå¸¸è¾“å‡ºï¼š/home/username/.bash_history

# æŸ¥çœ‹å†å²æ–‡ä»¶å†…å®¹
cat ~/.bash_history
```

**å­˜å‚¨æ—¶æœº**ï¼š
```
å‘½ä»¤æ‰§è¡Œæµç¨‹ï¼š
è¾“å…¥å‘½ä»¤ â†’ æ‰§è¡Œå‘½ä»¤ â†’ æš‚å­˜åœ¨å†…å­˜ â†’ Shellé€€å‡ºæ—¶å†™å…¥æ–‡ä»¶

é‡è¦ç†è§£ï¼š
â€¢ å†…å­˜ä¸­çš„å†å²ï¼šå½“å‰ä¼šè¯çš„ä¸´æ—¶è®°å½•
â€¢ æ–‡ä»¶ä¸­çš„å†å²ï¼šæŒä¹…ä¿å­˜çš„å†å²è®°å½•
â€¢ ä¸¤è€…ä¼šåœ¨Shellå¯åŠ¨å’Œé€€å‡ºæ—¶åŒæ­¥
```

### 1.3 å†å²è®°å½•çš„åŸºæœ¬æŸ¥çœ‹


**åŸºç¡€æŸ¥çœ‹å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹å†å²è®°å½•
history

# æŸ¥çœ‹æœ€è¿‘10æ¡å†å²
history 10

# æŸ¥çœ‹å¸¦è¡Œå·çš„å†å²
history | nl
```

**å®ç”¨æŸ¥çœ‹æŠ€å·§**ï¼š
```bash
# æœç´¢å†å²ä¸­çš„ç‰¹å®šå‘½ä»¤
history | grep "ssh"

# æŸ¥çœ‹ä»Šå¤©çš„å†å²è®°å½•
history | grep "$(date +%Y-%m-%d)"

# å€’åºæŸ¥çœ‹æœ€æ–°çš„å†å²
history | tail -20
```

---

## 2. âš™ï¸ æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£


### 2.1 HISTSIZE - å†…å­˜å†å²å¤§å°


**æ¦‚å¿µè§£é‡Š**ï¼š`HISTSIZE` æ§åˆ¶Shellåœ¨å†…å­˜ä¸­ä¿å­˜å¤šå°‘æ¡å†å²è®°å½•

```bash
# æŸ¥çœ‹å½“å‰è®¾ç½®
echo $HISTSIZE

# è®¾ç½®å†…å­˜ä¸­ä¿å­˜1000æ¡å†å²
export HISTSIZE=1000

# è®¾ç½®æ›´å¤§çš„å†å²è®°å½•ï¼ˆæ¨èï¼‰
export HISTSIZE=10000
```

**é€šä¿—ç†è§£**ï¼š
```
ç±»æ¯”ï¼šå†…å­˜å†å²å°±åƒä½ çš„"å·¥ä½œå°"
â€¢ HISTSIZE=1000 â†’ å·¥ä½œå°ä¸Šæœ€å¤šæ”¾1000å¼ çº¸
â€¢ è¶…è¿‡1000å¼ æ—¶ï¼Œæœ€æ—§çš„ä¼šè¢«ä¸¢æ‰
â€¢ æ•°å­—è¶Šå¤§ï¼Œèƒ½"æš‚å­˜"çš„å‘½ä»¤è¶Šå¤š

å®é™…å½±å“ï¼š
â€¢ å½±å“ history å‘½ä»¤æ˜¾ç¤ºçš„è®°å½•æ•°é‡
â€¢ å½±å“æ–¹å‘é”®â†‘â†“ç¿»æ‰¾å†å²çš„èŒƒå›´
â€¢ å½±å“Ctrl+Ræœç´¢å†å²çš„èŒƒå›´
```

### 2.2 HISTFILESIZE - æ–‡ä»¶å†å²å¤§å°


**æ¦‚å¿µè§£é‡Š**ï¼š`HISTFILESIZE` æ§åˆ¶å†å²æ–‡ä»¶ä¸­æœ€å¤šä¿å­˜å¤šå°‘æ¡è®°å½•

```bash
# æŸ¥çœ‹å½“å‰è®¾ç½®
echo $HISTFILESIZE

# è®¾ç½®æ–‡ä»¶ä¸­ä¿å­˜2000æ¡å†å²
export HISTFILESIZE=2000

# è®¾ç½®æ— é™å†å²è®°å½•
export HISTFILESIZE=-1
```

**HISTSIZE vs HISTFILESIZE åŒºåˆ«**ï¼š
```
å½¢è±¡æ¯”å–»ï¼š
HISTSIZEï¼ˆå†…å­˜ï¼‰ = ä½ å½“å‰èƒ½è®°ä½çš„äº‹æƒ…æ•°é‡
HISTFILESIZEï¼ˆæ–‡ä»¶ï¼‰ = ä½ æ—¥è®°æœ¬èƒ½å†™å¤šå°‘é¡µ

å®é™…åŒºåˆ«ï¼š
HISTSIZE=1000, HISTFILESIZE=5000
â€¢ å½“å‰ä¼šè¯èƒ½è®¿é—®1000æ¡å†å²
â€¢ æ–‡ä»¶ä¸­å®é™…ä¿å­˜5000æ¡å†å²
â€¢ é‡å¯Shellåï¼Œä»æ–‡ä»¶åŠ è½½æœ€æ–°1000æ¡åˆ°å†…å­˜
```

### 2.3 HISTCONTROL - é‡å¤å‘½ä»¤æ§åˆ¶


**æ¦‚å¿µè§£é‡Š**ï¼š`HISTCONTROL` æ§åˆ¶å“ªäº›å‘½ä»¤ä¸è¢«è®°å½•åˆ°å†å²ä¸­

```bash
# æŸ¥çœ‹å½“å‰è®¾ç½®
echo $HISTCONTROL

# å¿½ç•¥é‡å¤å‘½ä»¤
export HISTCONTROL=ignoredups

# å¿½ç•¥ä»¥ç©ºæ ¼å¼€å¤´çš„å‘½ä»¤
export HISTCONTROL=ignorespace

# ç»„åˆä½¿ç”¨ï¼ˆæ¨èï¼‰
export HISTCONTROL=ignoreboth
```

**å„é€‰é¡¹è¯¦è§£**ï¼š
```
ignoredupsï¼ˆå¿½ç•¥é‡å¤ï¼‰ï¼š
è¿ç»­é‡å¤çš„å‘½ä»¤åªè®°å½•ä¸€æ¬¡
ä¾‹å¦‚ï¼šls â†’ ls â†’ pwd â†’ ls
è®°å½•ï¼šls â†’ pwd â†’ ls

ignorespaceï¼ˆå¿½ç•¥ç©ºæ ¼å¼€å¤´ï¼‰ï¼š
ä»¥ç©ºæ ¼å¼€å¤´çš„å‘½ä»¤ä¸è®°å½•
ä¾‹å¦‚ï¼š rm secret.txt  ï¼ˆå‰é¢æœ‰ç©ºæ ¼ï¼‰
ç”¨é€”ï¼šæ‰§è¡Œæ•æ„Ÿå‘½ä»¤æ—¶é¿å…ç•™ä¸‹è®°å½•

ignorebothï¼š
åŒæ—¶å¯ç”¨ä¸Šé¢ä¸¤ä¸ªé€‰é¡¹
```

### 2.4 HISTIGNORE - å‘½ä»¤è¿‡æ»¤


**æ¦‚å¿µè§£é‡Š**ï¼š`HISTIGNORE` æŒ‡å®šå“ªäº›å‘½ä»¤ç±»å‹å®Œå…¨ä¸è®°å½•

```bash
# å¿½ç•¥ç®€å•å‘½ä»¤
export HISTIGNORE="ls:pwd:history"

# å¿½ç•¥æ¨¡å¼åŒ¹é…å‘½ä»¤
export HISTIGNORE="ls*:cd*:history*"

# å¤æ‚è¿‡æ»¤è§„åˆ™
export HISTIGNORE="ls:pwd:history:clear:exit:logout:w:who"
```

**å®ç”¨è¿‡æ»¤ç­–ç•¥**ï¼š
```bash
# æ—¥å¸¸å¼€å‘æ¨èé…ç½®
export HISTIGNORE="ls:ll:pwd:history:clear:exit:cd:cd ..:cd ~"

# å®‰å…¨å¢å¼ºé…ç½®
export HISTIGNORE="ls:pwd:history:clear:exit:passwd:su:sudo su"
```

### 2.5 HISTTIMEFORMAT - æ—¶é—´æˆ³æ ¼å¼


**æ¦‚å¿µè§£é‡Š**ï¼š`HISTTIMEFORMAT` ä¸ºå†å²è®°å½•æ·»åŠ æ—¶é—´æˆ³æ˜¾ç¤º

```bash
# åŸºæœ¬æ—¶é—´æ ¼å¼
export HISTTIMEFORMAT="%Y-%m-%d %H:%M:%S "

# æŸ¥çœ‹å¸¦æ—¶é—´çš„å†å²
history
```

**æ—¶é—´æ ¼å¼é€‰é¡¹**ï¼š
```bash
# ä¸åŒçš„æ—¶é—´æ˜¾ç¤ºæ ¼å¼
export HISTTIMEFORMAT="%F %T "          # 2025-09-13 15:30:45
export HISTTIMEFORMAT="%Y-%m-%d %H:%M " # 2025-09-13 15:30
export HISTTIMEFORMAT="%m/%d %H:%M "     # 09/13 15:30
export HISTTIMEFORMAT="[%F %T] "         # [2025-09-13 15:30:45]
```

**æ—¶é—´æˆ³çš„å®é™…ä½œç”¨**ï¼š
```
å®ç”¨ä»·å€¼ï¼š
â€¢ æ’æŸ¥é—®é¢˜æ—¶çŸ¥é“å‘½ä»¤æ‰§è¡Œçš„å…·ä½“æ—¶é—´
â€¢ å®¡è®¡ç³»ç»Ÿæ“ä½œçš„æ—¶é—´çº¿
â€¢ å›é¡¾å·¥ä½œå†…å®¹å’Œæ—¶é—´å®‰æ’
â€¢ å®‰å…¨äº‹ä»¶è°ƒæŸ¥æ—¶çš„é‡è¦è¯æ®

æ³¨æ„äº‹é¡¹ï¼š
â€¢ åªå¯¹æ–°å‘½ä»¤ç”Ÿæ•ˆï¼Œæ—§å†å²ä¸ä¼šæ˜¾ç¤ºæ—¶é—´
â€¢ ä¼šå ç”¨æ›´å¤šæ˜¾ç¤ºç©ºé—´
â€¢ æ—¶é—´æˆ³ä¿¡æ¯å­˜å‚¨åœ¨å†å²æ–‡ä»¶ä¸­
```

---

## 3. ğŸ›ï¸ å†å²è®°å½•æ§åˆ¶ç­–ç•¥


### 3.1 å®æ—¶å†å²è®°å½•ä¿å­˜


**é—®é¢˜åœºæ™¯**ï¼š
```
é»˜è®¤æƒ…å†µä¸‹çš„é—®é¢˜ï¼š
å¼€äº†3ä¸ªç»ˆç«¯çª—å£ â†’ åªæœ‰æœ€åå…³é—­çš„çª—å£å†å²ä¼šè¢«ä¿å­˜
å…¶ä»–çª—å£çš„å‘½ä»¤å†å²ä¸¢å¤±ï¼

è§£å†³æ€è·¯ï¼š
è®©æ¯ä¸ªå‘½ä»¤æ‰§è¡Œåç«‹å³å†™å…¥å†å²æ–‡ä»¶
è€Œä¸æ˜¯ç­‰Shellé€€å‡ºæ—¶æ‰å†™å…¥
```

**å®æ—¶ä¿å­˜é…ç½®**ï¼š
```bash
# åœ¨ .bashrc ä¸­æ·»åŠ 
export PROMPT_COMMAND="history -a"

# æˆ–è€…æ›´å®Œæ•´çš„é…ç½®
export PROMPT_COMMAND="history -a; history -c; history -r"
```

**é…ç½®è§£é‡Š**ï¼š
```
history -aï¼šè¿½åŠ æ–°å†å²åˆ°æ–‡ä»¶
history -cï¼šæ¸…ç©ºå½“å‰å†…å­˜å†å²
history -rï¼šé‡æ–°ä»æ–‡ä»¶è¯»å–å†å²

æ‰§è¡Œæµç¨‹ï¼š
è¾“å…¥å‘½ä»¤ â†’ æ‰§è¡Œå‘½ä»¤ â†’ history -aå†™å…¥æ–‡ä»¶ â†’ æ˜¾ç¤ºæç¤ºç¬¦
```

### 3.2 å†å²è®°å½•å»é‡ç­–ç•¥


**å»é‡éœ€æ±‚**ï¼š
```
å¸¸è§é—®é¢˜ï¼š
lså‘½ä»¤æ‰§è¡Œäº†50æ¬¡ â†’ å†å²è®°å½•é‡Œå…¨æ˜¯ls
çœŸæ­£æœ‰ç”¨çš„å‘½ä»¤è¢«æŒ¤æ‰äº†

è§£å†³æ–¹æ¡ˆï¼š
1. ä½¿ç”¨HISTCONTROL=ignoredups
2. é…åˆHISTIGNOREè¿‡æ»¤å¸¸ç”¨å‘½ä»¤
3. å®šæœŸæ¸…ç†é‡å¤å†å²
```

**æ™ºèƒ½å»é‡é…ç½®**ï¼š
```bash
# åŸºç¡€å»é‡
export HISTCONTROL=ignoreboth

# é«˜çº§å»é‡ - å¿½ç•¥å¸¸ç”¨ç®€å•å‘½ä»¤
export HISTIGNORE="ls:ll:la:pwd:clear:history:exit:logout"
export HISTIGNORE="$HISTIGNORE:cd:cd ..:cd ~:w:who:date"

# å¿½ç•¥å•å­—ç¬¦å‘½ä»¤
export HISTIGNORE="$HISTIGNORE:?:??"
```

### 3.3 æŒ‰ç”¨é€”åˆ†ç±»å†å²


**åˆ†ç±»å­˜å‚¨æ¦‚å¿µ**ï¼š
```
ä¸åŒç±»å‹çš„å·¥ä½œä½¿ç”¨ä¸åŒçš„å†å²æ–‡ä»¶
â€¢ å¼€å‘å·¥ä½œï¼šä¿å­˜ç¼–ç¨‹ç›¸å…³å‘½ä»¤
â€¢ ç³»ç»Ÿç®¡ç†ï¼šä¿å­˜è¿ç»´ç›¸å…³å‘½ä»¤  
â€¢ æ—¥å¸¸ä½¿ç”¨ï¼šä¿å­˜å¸¸è§„æ“ä½œå‘½ä»¤
```

**å®ç°æ–¹å¼**ï¼š
```bash
# åˆ›å»ºä¸åŒçš„å†å²æ–‡ä»¶
mkdir -p ~/.history_files

# æ ¹æ®å·¥ä½œç±»å‹åˆ‡æ¢å†å²æ–‡ä»¶
function work_mode() {
    export HISTFILE=~/.history_files/work_history
    history -r
}

function admin_mode() {
    export HISTFILE=~/.history_files/admin_history
    history -r
}

function normal_mode() {
    export HISTFILE=~/.bash_history
    history -r
}
```

---

## 4. ğŸ”„ å¤šç»ˆç«¯å†å²åŒæ­¥æœºåˆ¶


### 4.1 å¤šç»ˆç«¯å†å²å†²çªé—®é¢˜


**é—®é¢˜æè¿°**ï¼š
```
ç°è±¡ï¼š
ç»ˆç«¯Aï¼šæ‰§è¡Œäº† git clone xxx
ç»ˆç«¯Bï¼šæŒ‰â†‘é”®æ‰¾ä¸åˆ°è¿™ä¸ªå‘½ä»¤

åŸå› ï¼š
æ¯ä¸ªShellä¼šè¯æœ‰ç‹¬ç«‹çš„å†å²å†…å­˜
åªåœ¨å¯åŠ¨æ—¶è¯»å–å†å²æ–‡ä»¶
åªåœ¨é€€å‡ºæ—¶å†™å…¥å†å²æ–‡ä»¶
```

**ä¼ ç»Ÿé—®é¢˜åœºæ™¯**ï¼š
```
åœºæ™¯1 - å†å²è¦†ç›–ï¼š
ç»ˆç«¯Aï¼šæ‰§è¡Œ100ä¸ªå‘½ä»¤ â†’ é€€å‡º
ç»ˆç«¯Bï¼šæ‰§è¡Œ50ä¸ªå‘½ä»¤ â†’ é€€å‡º
ç»“æœï¼šåªä¿ç•™äº†ç»ˆç«¯Bçš„50ä¸ªå‘½ä»¤ï¼

åœºæ™¯2 - å†å²å‰²è£‚ï¼š
ç»ˆç«¯Aï¼šgitå‘½ä»¤
ç»ˆç«¯Bï¼šdockerå‘½ä»¤  
ç»ˆç«¯Cï¼šæ— æ³•çœ‹åˆ°Aã€Bçš„å‘½ä»¤å†å²
```

### 4.2 å®ç°å†å²åŒæ­¥çš„æ–¹æ³•


**æ–¹æ³•ä¸€ï¼šå®æ—¶åŒæ­¥é…ç½®**
```bash
# åœ¨ .bashrc ä¸­æ·»åŠ 
export PROMPT_COMMAND="history -a; history -c; history -r"

# é…ç½®è¯´æ˜
history -a  # è¿½åŠ å½“å‰ä¼šè¯æ–°å†å²åˆ°æ–‡ä»¶
history -c  # æ¸…ç©ºå½“å‰å†…å­˜å†å²  
history -r  # ä»æ–‡ä»¶é‡æ–°è¯»å–æ‰€æœ‰å†å²
```

**æ–¹æ³•äºŒï¼šæ™ºèƒ½åŒæ­¥é…ç½®**
```bash
# æ›´é«˜æ•ˆçš„åŒæ­¥æ–¹å¼
export PROMPT_COMMAND="history -a; history -n"

# é…ç½®è¯´æ˜  
history -a  # è¿½åŠ æ–°å†å²åˆ°æ–‡ä»¶
history -n  # åªè¯»å–æ–‡ä»¶ä¸­çš„æ–°å†å²åˆ°å†…å­˜
```

**åŒæ­¥æ•ˆæœå¯¹æ¯”**ï¼š
```
æ–¹æ³•ä¸€ï¼ˆå®Œå…¨åŒæ­¥ï¼‰ï¼š
ä¼˜ç‚¹ï¼šæ‰€æœ‰ç»ˆç«¯å†å²å®Œå…¨ä¸€è‡´
ç¼ºç‚¹ï¼šæ¯æ¬¡æç¤ºç¬¦éƒ½é‡æ–°åŠ è½½å…¨éƒ¨å†å²ï¼Œè¾ƒæ…¢

æ–¹æ³•äºŒï¼ˆå¢é‡åŒæ­¥ï¼‰ï¼š
ä¼˜ç‚¹ï¼šåªåŒæ­¥æ–°å¢å†å²ï¼Œé€Ÿåº¦å¿«
ç¼ºç‚¹ï¼šå¯èƒ½å­˜åœ¨çŸ­æš‚çš„å†å²ä¸ä¸€è‡´
```

### 4.3 é€‰æ‹©æ€§å†å²åŒæ­¥


**åœºæ™¯éœ€æ±‚**ï¼š
```
æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›æ‰€æœ‰ç»ˆç«¯çš„å†å²éƒ½æ··åœ¨ä¸€èµ·
ä¾‹å¦‚ï¼š
â€¢ å·¥ä½œç»ˆç«¯ï¼šåªçœ‹å·¥ä½œç›¸å…³å‘½ä»¤
â€¢ æµ‹è¯•ç»ˆç«¯ï¼šåªçœ‹æµ‹è¯•ç›¸å…³å‘½ä»¤
â€¢ ä¸´æ—¶ç»ˆç«¯ï¼šä¸ä¿å­˜å†å²
```

**å®ç°æŒ‰éœ€åŒæ­¥**ï¼š
```bash
# åˆ›å»ºå†å²åŒæ­¥å‡½æ•°
function sync_history() {
    history -a
    history -c  
    history -r
    echo "å†å²å·²åŒæ­¥"
}

# åˆ›å»ºå¿«æ·åˆ«å
alias hs='sync_history'

# æ‰‹åŠ¨åŒæ­¥ï¼šéœ€è¦æ—¶è¾“å…¥ hs
```

**ä¸´æ—¶ä¼šè¯ä¸ä¿å­˜å†å²**ï¼š
```bash
# å¯åŠ¨ä¸ä¿å­˜å†å²çš„ä¼šè¯
unset HISTFILE

# æˆ–è€…è®¾ç½®ä¸´æ—¶å†å²æ–‡ä»¶
export HISTFILE=/tmp/temp_history_$$
```

---

## 5. ğŸ”’ å†å²è®°å½•å®‰å…¨ä¸æ¸…ç†


### 5.1 æ•æ„Ÿä¿¡æ¯é˜²æŠ¤


**å®‰å…¨é£é™©**ï¼š
```
å¸¸è§çš„æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼š
â€¢ mysql -u root -pPASSWORD
â€¢ curl -H "Authorization: token"  
â€¢ scp user:password@server
â€¢ export API_KEY=secret123

é£é™©ï¼š
å†å²è®°å½•è¢«å…¶ä»–äººæŸ¥çœ‹
å¯†ç å’Œå¯†é’¥æ³„éœ²
```

**é˜²æŠ¤ç­–ç•¥**ï¼š
```bash
# 1. ç©ºæ ¼å¼€å¤´å‘½ä»¤ä¸è®°å½•å†å²
export HISTCONTROL=ignorespace

# ä½¿ç”¨ç¤ºä¾‹ï¼ˆæ³¨æ„å‰é¢çš„ç©ºæ ¼ï¼‰
 mysql -u root -pSECRET
 export API_KEY=secret123

# 2. è¿‡æ»¤åŒ…å«å¯†ç çš„å‘½ä»¤
export HISTIGNORE="*password*:*passwd*:*secret*:*key*"

# 3. ä½¿ç”¨ç¯å¢ƒå˜é‡ä»£æ›¿ç›´æ¥è¾“å…¥
export DB_PASSWORD=secret123
mysql -u root -p$DB_PASSWORD
```

### 5.2 å†å²è®°å½•æ¸…ç†


**æ¸…ç†ç‰¹å®šå‘½ä»¤**ï¼š
```bash
# æŸ¥æ‰¾åŒ…å«å¯†ç çš„å†å²è®°å½•
history | grep -i password

# åˆ é™¤ç‰¹å®šè¡Œå·çš„å†å²
history -d 1234

# åˆ é™¤å¤šè¡Œå†å²
history -d 1234
history -d 1235
history -d 1236
```

**æ‰¹é‡æ¸…ç†æ•æ„Ÿå†å²**ï¼š
```bash
# åˆ›å»ºæ¸…ç†è„šæœ¬
cat > ~/.clean_history.sh << 'EOF'
#!/bin/bash
# å¤‡ä»½åŸå†å²æ–‡ä»¶
cp ~/.bash_history ~/.bash_history.backup

# è¿‡æ»¤æ‰åŒ…å«æ•æ„Ÿè¯çš„è¡Œ
grep -v -i -E '(password|passwd|secret|key|token)' ~/.bash_history > /tmp/clean_history
mv /tmp/clean_history ~/.bash_history

# é‡æ–°åŠ è½½å†å²
history -c
history -r

echo "æ•æ„Ÿå†å²å·²æ¸…ç†"
EOF

chmod +x ~/.clean_history.sh
```

### 5.3 å®Œå…¨æ¸…ç©ºå†å²


**æ¸…ç©ºå½“å‰ä¼šè¯å†å²**ï¼š
```bash
# æ¸…ç©ºå†…å­˜ä¸­çš„å†å²
history -c

# æ¸…ç©ºå†å²æ–‡ä»¶
> ~/.bash_history

# æˆ–è€…åˆ é™¤å†å²æ–‡ä»¶
rm ~/.bash_history
```

**å®‰å…¨æ¸…ç†æµç¨‹**ï¼š
```bash
# å®Œæ•´çš„å®‰å…¨æ¸…ç†æµç¨‹
function secure_clean_history() {
    # 1. å¤‡ä»½ï¼ˆå¦‚æœéœ€è¦ï¼‰
    cp ~/.bash_history ~/.bash_history.$(date +%Y%m%d)
    
    # 2. æ¸…ç©ºå½“å‰å†…å­˜å†å²
    history -c
    
    # 3. æ¸…ç©ºå†å²æ–‡ä»¶
    > ~/.bash_history
    
    # 4. åˆ é™¤å…¶ä»–å¯èƒ½çš„å†å²æ–‡ä»¶
    rm -f ~/.history_files/* 2>/dev/null
    
    echo "æ‰€æœ‰å†å²è®°å½•å·²å®‰å…¨æ¸…ç†"
}
```

---

## 6. ğŸš€ é«˜çº§å†å²æ“ä½œæŠ€å·§


### 6.1 fcå‘½ä»¤å†å²ç¼–è¾‘


**fcå‘½ä»¤ç®€ä»‹**ï¼š
```
fc = Fix Commandï¼Œä¿®å¤å‘½ä»¤
ä½œç”¨ï¼šç”¨ç¼–è¾‘å™¨ä¿®æ”¹å’Œé‡æ–°æ‰§è¡Œå†å²å‘½ä»¤
ç‰¹åˆ«é€‚åˆä¿®æ”¹å¤æ‚çš„é•¿å‘½ä»¤
```

**åŸºæœ¬ç”¨æ³•**ï¼š
```bash
# ç¼–è¾‘å¹¶æ‰§è¡Œæœ€åä¸€ä¸ªå‘½ä»¤
fc

# ç¼–è¾‘æŒ‡å®šè¡Œå·çš„å‘½ä»¤
fc 123

# ç¼–è¾‘æœ€è¿‘åŒ…å«"git"çš„å‘½ä»¤
fc -s git

# ç¼–è¾‘å€’æ•°ç¬¬3ä¸ªå‘½ä»¤
fc -3
```

**å®ç”¨åœºæ™¯**ï¼š
```bash
# åœºæ™¯ï¼šæ‰§è¡Œäº†ä¸€ä¸ªå¾ˆé•¿çš„å‘½ä»¤ä½†æœ‰ä¸ªå°é”™è¯¯
docker run -d --name myapp -p 8080:80 -v /data:/app nginx:latet
# å‘ç°nginxç‰ˆæœ¬å†™é”™äº†(latetåº”è¯¥æ˜¯latest)

# ä½¿ç”¨fcç¼–è¾‘
fc
# åœ¨ç¼–è¾‘å™¨ä¸­ä¿®æ”¹ï¼Œä¿å­˜é€€å‡ºåè‡ªåŠ¨æ‰§è¡Œä¿®æ­£åçš„å‘½ä»¤
```

### 6.2 å†å²æ›¿æ¢æŠ€å·§


**å¿«é€Ÿæ›¿æ¢**ï¼š
```bash
# !! è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤
sudo !!  # ç”¨sudoæ‰§è¡Œä¸Šä¸€ä¸ªå‘½ä»¤

# !n è¡¨ç¤ºç¬¬nè¡Œå†å²
!123     # æ‰§è¡Œç¬¬123è¡Œçš„å‘½ä»¤

# !string è¡¨ç¤ºæœ€è¿‘ä»¥stringå¼€å¤´çš„å‘½ä»¤
!git     # æ‰§è¡Œæœ€è¿‘çš„gitå‘½ä»¤
!ssh     # æ‰§è¡Œæœ€è¿‘çš„sshå‘½ä»¤
```

**å‚æ•°æ›¿æ¢**ï¼š
```bash
# !$ è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°
ls /very/long/path/to/file.txt
cd !$  # ç­‰äº cd /very/long/path/to/file.txt

# !^ è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°
cp /source/file.txt /dest/
ls !^  # ç­‰äº ls /source/file.txt

# !* è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤çš„æ‰€æœ‰å‚æ•°
rm file1.txt file2.txt file3.txt
ls !*  # ç­‰äº ls file1.txt file2.txt file3.txt
```

### 6.3 äº¤äº’å¼å†å²æœç´¢


**Ctrl+R åå‘æœç´¢**ï¼š
```
æ“ä½œæ­¥éª¤ï¼š
1. æŒ‰ Ctrl+R
2. è¾“å…¥æœç´¢å…³é”®è¯
3. ç»§ç»­æŒ‰ Ctrl+R æŸ¥æ‰¾ä¸Šä¸€ä¸ªåŒ¹é…
4. æŒ‰ Enter æ‰§è¡Œï¼Œæˆ–æŒ‰ Ctrl+C å–æ¶ˆ

å®ç”¨æŠ€å·§ï¼š
â€¢ è¾“å…¥å‘½ä»¤çš„å…³é”®éƒ¨åˆ†ï¼Œä¸ç”¨å®Œæ•´è¾“å…¥
â€¢ å¯ä»¥æœç´¢å‘½ä»¤ä¸­çš„ä»»ä½•éƒ¨åˆ†
â€¢ æ”¯æŒå¢é‡æœç´¢ï¼Œè¾¹è¾“å…¥è¾¹åŒ¹é…
```

**å†å²æœç´¢è„šæœ¬**ï¼š
```bash
# åˆ›å»ºå†å²æœç´¢å‡½æ•°
function hist_search() {
    if [ $# -eq 0 ]; then
        echo "ç”¨æ³•: hist_search <æœç´¢å…³é”®è¯>"
        return 1
    fi
    
    history | grep -i "$1" | tail -20
}

# åˆ«å
alias hs='hist_search'

# ä½¿ç”¨ç¤ºä¾‹
hs git        # æœç´¢åŒ…å«gitçš„å†å²å‘½ä»¤
hs "docker"   # æœç´¢åŒ…å«dockerçš„å†å²å‘½ä»¤
```

---

## 7. âš¡ å®ç”¨é…ç½®å®æˆ˜


### 7.1 æ¨èçš„å®Œæ•´é…ç½®


**åŸºç¡€é…ç½®**ï¼š
```bash
# æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.bash_profile

# å†å²è®°å½•å¤§å°
export HISTSIZE=10000
export HISTFILESIZE=20000

# å†å²è®°å½•æ§åˆ¶
export HISTCONTROL=ignoreboth

# è¿‡æ»¤å¸¸ç”¨å‘½ä»¤
export HISTIGNORE="ls:ll:la:pwd:clear:history:exit:logout:cd:cd ..:cd ~"

# æ·»åŠ æ—¶é—´æˆ³
export HISTTIMEFORMAT="%F %T "

# å®æ—¶ä¿å­˜å†å²
export PROMPT_COMMAND="history -a"
```

**é«˜çº§é…ç½®**ï¼š
```bash
# é«˜çº§å†å²è®°å½•é…ç½®

# æ— é™å†å²è®°å½•
export HISTSIZE=-1
export HISTFILESIZE=-1

# å¤šè¡Œå‘½ä»¤å®Œæ•´ä¿å­˜
shopt -s cmdhist

# å†å²è®°å½•è¿½åŠ è€Œéè¦†ç›–
shopt -s histappend

# çº æ­£å†å²è®°å½•ä¸­çš„å°é”™è¯¯
shopt -s histverify

# å®æ—¶åŒæ­¥å¤šç»ˆç«¯å†å²
export PROMPT_COMMAND="history -a; history -n"
```

### 7.2 ä¸ªæ€§åŒ–å†å²ç®¡ç†


**åˆ›å»ºå†å²ç®¡ç†å·¥å…·**ï¼š
```bash
# æ·»åŠ åˆ° ~/.bashrc

# å†å²ç»Ÿè®¡å‡½æ•°
function hist_stats() {
    echo "=== å†å²è®°å½•ç»Ÿè®¡ ==="
    echo "æ€»å‘½ä»¤æ•°: $(history | wc -l)"
    echo "æœ€å¸¸ç”¨çš„10ä¸ªå‘½ä»¤:"
    history | awk '{print $4}' | sort | uniq -c | sort -nr | head -10
}

# å†å²å¤‡ä»½å‡½æ•°
function backup_history() {
    local backup_dir="$HOME/.history_backups"
    mkdir -p "$backup_dir"
    cp ~/.bash_history "$backup_dir/bash_history_$(date +%Y%m%d_%H%M%S)"
    echo "å†å²å·²å¤‡ä»½åˆ° $backup_dir"
}

# å†å²æ¸…ç†å‡½æ•°
function clean_old_history() {
    # åªä¿ç•™æœ€è¿‘30å¤©çš„å†å²
    local temp_file=$(mktemp)
    local cutoff_date=$(date -d '30 days ago' +%s)
    
    while IFS= read -r line; do
        if [[ $line =~ ^#([0-9]+)$ ]]; then
            timestamp=${BASH_REMATCH[1]}
            if [ $timestamp -gt $cutoff_date ]; then
                echo "$line" >> "$temp_file"
            fi
        else
            echo "$line" >> "$temp_file"
        fi
    done < ~/.bash_history
    
    mv "$temp_file" ~/.bash_history
    history -c
    history -r
    echo "å·²æ¸…ç†30å¤©å‰çš„å†å²è®°å½•"
}
```

### 7.3 é¡¹ç›®ç›¸å…³å†å²


**æŒ‰é¡¹ç›®ç®¡ç†å†å²**ï¼š
```bash
# é¡¹ç›®å†å²ç®¡ç†

# åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•æ—¶è‡ªåŠ¨åˆ‡æ¢å†å²æ–‡ä»¶
function cd() {
    builtin cd "$@"
    
    # æ£€æŸ¥æ˜¯å¦åœ¨Gité¡¹ç›®ä¸­
    if git rev-parse --git-dir > /dev/null 2>&1; then
        local project_name=$(basename $(git rev-parse --show-toplevel))
        local hist_dir="$HOME/.project_histories"
        mkdir -p "$hist_dir"
        
        export HISTFILE="$hist_dir/${project_name}_history"
        history -a  # ä¿å­˜å½“å‰å†å²
        history -c  # æ¸…ç©ºå†…å­˜
        history -r  # è¯»å–é¡¹ç›®å†å²
    else
        export HISTFILE="$HOME/.bash_history"
        history -a
        history -c
        history -r
    fi
}

# æŸ¥çœ‹é¡¹ç›®å†å²ç»Ÿè®¡
function project_hist_stats() {
    local hist_dir="$HOME/.project_histories"
    if [ -d "$hist_dir" ]; then
        echo "=== é¡¹ç›®å†å²ç»Ÿè®¡ ==="
        for file in "$hist_dir"/*_history; do
            if [ -f "$file" ]; then
                local project=$(basename "$file" _history)
                local count=$(wc -l < "$file")
                echo "$project: $count æ¡å‘½ä»¤"
            fi
        done
    fi
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å†å²è®°å½•æœºåˆ¶ï¼šå†…å­˜æš‚å­˜ + æ–‡ä»¶æŒä¹…åŒ–çš„åŒå±‚ç»“æ„
ğŸ”¸ æ ¸å¿ƒé…ç½®å‚æ•°ï¼šHISTSIZEã€HISTFILESIZEã€HISTCONTROLã€HISTIGNORE
ğŸ”¸ æ—¶é—´æˆ³é…ç½®ï¼šHISTTIMEFORMATä¸ºå†å²è®°å½•æ·»åŠ æ—¶é—´ä¿¡æ¯  
ğŸ”¸ å¤šç»ˆç«¯åŒæ­¥ï¼šPROMPT_COMMANDå®ç°å®æ—¶å†å²åŒæ­¥
ğŸ”¸ å®‰å…¨é˜²æŠ¤ï¼šè¿‡æ»¤æ•æ„Ÿå‘½ä»¤ï¼Œå®šæœŸæ¸…ç†å†å²è®°å½•
ğŸ”¸ é«˜çº§æ“ä½œï¼šfcç¼–è¾‘å‘½ä»¤ï¼Œ!!é‡å¤æ‰§è¡Œï¼ŒCtrl+Ræœç´¢
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å†å²è®°å½•çš„å­˜å‚¨æ—¶æœº**
```
ç†è§£è¦ç‚¹ï¼š
â€¢ å‘½ä»¤æ‰§è¡Œåæš‚å­˜åœ¨å†…å­˜ä¸­
â€¢ Shellæ­£å¸¸é€€å‡ºæ—¶å†™å…¥å†å²æ–‡ä»¶
â€¢ å¼‚å¸¸é€€å‡ºï¼ˆå¦‚å¼ºåˆ¶å…³é—­ï¼‰ä¼šä¸¢å¤±æœªä¿å­˜çš„å†å²
â€¢ PROMPT_COMMANDå¯ä»¥æ”¹å˜è¿™ä¸ªé»˜è®¤è¡Œä¸º
```

**ğŸ”¹ å¤šç»ˆç«¯å†å²å†²çªçš„æœ¬è´¨**
```
æ ¹æœ¬åŸå› ï¼š
â€¢ æ¯ä¸ªShellä¼šè¯ç‹¬ç«‹ç®¡ç†å†å²
â€¢ åé€€å‡ºçš„ä¼šè¯ä¼šè¦†ç›–å†å²æ–‡ä»¶
â€¢ è§£å†³å…³é”®ï¼šæ”¹å˜å†™å…¥æ—¶æœºï¼Œä»"é€€å‡ºæ—¶"æ”¹ä¸º"å®æ—¶"
```

**ğŸ”¹ å®‰å…¨ä¸ä¾¿åˆ©çš„å¹³è¡¡**
```
å®‰å…¨è€ƒè™‘ï¼š
â€¢ æ•æ„Ÿå‘½ä»¤ä¸åº”è¯¥ç•™åœ¨å†å²ä¸­
â€¢ å†å²æ–‡ä»¶æƒé™æ§åˆ¶å¾ˆé‡è¦
â€¢ å®šæœŸæ¸…ç†å’Œå¤‡ä»½å†å²è®°å½•

ä¾¿åˆ©æ€§è€ƒè™‘ï¼š
â€¢ å†å²è®°å½•æ˜¯æé«˜æ•ˆç‡çš„é‡è¦å·¥å…·
â€¢ è¿‡åº¦è¿‡æ»¤ä¼šå½±å“ä½¿ç”¨ä½“éªŒ
â€¢ éœ€è¦åœ¨å®‰å…¨å’Œä¾¿åˆ©é—´æ‰¾åˆ°å¹³è¡¡ç‚¹
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**æ—¥å¸¸å¼€å‘åœºæ™¯**ï¼š
```
â€¢ å¿«é€Ÿé‡å¤æ‰§è¡Œå¤æ‚çš„éƒ¨ç½²å‘½ä»¤
â€¢ å›é¡¾ä¹‹å‰çš„è°ƒè¯•æ­¥éª¤
â€¢ åœ¨å¤šä¸ªç»ˆç«¯é—´å…±äº«å‘½ä»¤å†å²
â€¢ è®°å½•å’Œåˆ†äº«æ“ä½œæµç¨‹
```

**ç³»ç»Ÿç®¡ç†åœºæ™¯**ï¼š
```
â€¢ å®¡è®¡ç³»ç»Ÿæ“ä½œè®°å½•
â€¢ æ’æŸ¥é—®é¢˜æ—¶å›é¡¾æ“ä½œå†å²
â€¢ å»ºç«‹æ“ä½œè§„èŒƒå’Œæœ€ä½³å®è·µ
â€¢ å®‰å…¨äº‹ä»¶è°ƒæŸ¥å’Œå–è¯
```

**å­¦ä¹ æå‡åœºæ™¯**ï¼š
```
â€¢ åˆ†æè‡ªå·±çš„å‘½ä»¤ä½¿ç”¨æ¨¡å¼
â€¢ å‘ç°å¯ä»¥ä¼˜åŒ–çš„é‡å¤æ“ä½œ
â€¢ å­¦ä¹ å’Œåˆ†äº«å¤æ‚å‘½ä»¤çš„ä½¿ç”¨
â€¢ å»ºç«‹ä¸ªäººçš„æ“ä½œçŸ¥è¯†åº“
```

### 8.4 é…ç½®å»ºè®®æ€»ç»“


**æ–°æ‰‹æ¨èé…ç½®**ï¼š
```bash
# ç®€å•å®ç”¨çš„é…ç½®
export HISTSIZE=5000
export HISTFILESIZE=10000
export HISTCONTROL=ignoreboth
export HISTTIMEFORMAT="%F %T "
```

**è¿›é˜¶ç”¨æˆ·é…ç½®**ï¼š
```bash
# å®Œæ•´çš„å†å²ç®¡ç†é…ç½®
export HISTSIZE=10000
export HISTFILESIZE=20000
export HISTCONTROL=ignoreboth
export HISTIGNORE="ls:pwd:clear:history:exit"
export HISTTIMEFORMAT="[%F %T] "
export PROMPT_COMMAND="history -a; history -n"
shopt -s histappend
```

**ä¸“ä¸šè¿ç»´é…ç½®**ï¼š
```bash
# å®‰å…¨æ€§å¢å¼ºçš„é…ç½®
export HISTSIZE=-1
export HISTFILESIZE=-1
export HISTCONTROL=ignoreboth
export HISTIGNORE="ls:pwd:clear:history:exit:*password*:*secret*"
export HISTTIMEFORMAT="[%F %T] "
export PROMPT_COMMAND="history -a"
# å®šæœŸå¤‡ä»½å’Œæ¸…ç†è„šæœ¬
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å†å²é…ç½®å››å¤§å‚æ•°ï¼šSIZEã€FILESIZEã€CONTROLã€IGNORE
- å®‰å…¨ç¬¬ä¸€è¿‡æ»¤æ•æ„Ÿï¼Œå®æ—¶åŒæ­¥å¤šç»ˆç«¯
- fcç¼–è¾‘ï¼Œ!!é‡å¤ï¼ŒCtrl+Ræ¥æœç´¢
- å¤‡ä»½æ¸…ç†å®šæœŸåšï¼Œå†å²ç®¡ç†å¥½å¸®æ‰‹