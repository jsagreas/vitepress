---
title: 5、sort排序工具专精
---
## 📚 目录

1. [sort工具基础概念](#1-sort工具基础概念)
2. [字典序与数值排序](#2-字典序与数值排序)
3. [字段排序与多字段处理](#3-字段排序与多字段处理)
4. [分隔符与逆序排序](#4-分隔符与逆序排序)
5. [去重与稳定排序](#5-去重与稳定排序)
6. [高级排序选项](#6-高级排序选项)
7. [大文件排序优化](#7-大文件排序优化)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 📋 sort工具基础概念


### 1.1 什么是sort工具


**核心定义**：`sort`是Linux系统中用于**对文本行进行排序**的命令行工具

> 💡 **通俗理解**  
> 就像整理书架一样，sort帮你把文件中的每一行按照一定规则重新排列，让数据变得有序

**基本工作原理**：
```
原始文件内容：    →    排序后结果：
banana                 apple
apple                  banana  
cherry                 cherry
```

### 1.2 sort的核心作用


**🎯 主要用途**：
- **数据整理**：让乱序的文本变得有序
- **去重处理**：配合选项去除重复行
- **数据分析**：为后续处理准备有序数据
- **日志分析**：按时间、IP等字段排序日志

**实际应用场景**：
```bash
# 场景1：整理用户列表
sort userlist.txt

# 场景2：按数值排序成绩
sort -n scores.txt

# 场景3：去重并排序
sort -u emails.txt
```

---

## 2. 🔢 字典序与数值排序


### 2.1 默认字典序排序


**什么是字典序**：按照字符的ASCII码值逐个比较，就像查字典一样

```bash
# 示例文件 numbers.txt
100
20
3
```

**默认字典序排序**：
```bash
sort numbers.txt
# 输出结果：
100    # '1' < '2' < '3'，所以100排最前
20
3
```

> ⚠️ **常见误区**  
> 字典序把"100"排在"20"前面，因为比较的是字符'1'和'2'，不是数值100和20

### 2.2 数值排序-n选项


**`-n`选项含义**：告诉sort把内容当作**数字**来比较，而不是字符

```bash
# 使用数值排序
sort -n numbers.txt
# 输出结果：
3      # 数值3最小
20     # 数值20居中
100    # 数值100最大
```

**更多数值排序示例**：
```bash
# 创建测试数据
echo -e "1.5\n2.1\n0.8" > decimals.txt

# 数值排序小数
sort -n decimals.txt
# 结果：0.8, 1.5, 2.1

# 处理负数
echo -e "-5\n10\n-2" | sort -n
# 结果：-5, -2, 10
```

### 2.3 字典序vs数值排序对比


| **排序方式** | **比较规则** | **"10" vs "2"** | **适用场景** |
|-------------|-------------|-----------------|-------------|
| 字典序(默认) | 逐字符比较ASCII | "10" < "2" | 文本、字母排序 |
| 数值排序(-n) | 按数值大小比较 | 10 > 2 | 数字、分数、统计 |

---

## 3. 🔍 字段排序与多字段处理


### 3.1 什么是字段排序


**字段概念**：把每行文本按**分隔符**分成若干部分，每部分就是一个字段

```
示例行：张三 25 工程师
字段1：张三    字段2：25    字段3：工程师
```

### 3.2 -k选项详解


**`-k`选项作用**：指定按**第几个字段**进行排序

```bash
# 示例数据 employees.txt
张三 25 工程师
李四 30 经理
王五 22 助理
```

**按第2个字段（年龄）数值排序**：
```bash
sort -k2 -n employees.txt
# 结果：
王五 22 助理    # 年龄22最小
张三 25 工程师  # 年龄25居中  
李四 30 经理    # 年龄30最大
```

> 💡 **-k选项格式说明**  
> `-k2` 表示按第2个字段排序  
> `-k2 -n` 表示按第2个字段进行数值排序

### 3.3 多字段排序


**多字段排序含义**：先按字段1排序，相同时再按字段2排序

```bash
# 示例数据 students.txt
张三 数学 85
李四 数学 92  
王五 英语 88
赵六 英语 88
```

**先按学科排序，再按成绩排序**：
```bash
sort -k2,2 -k3,3n students.txt
# 结果：
王五 英语 88    # 英语学科，成绩88
赵六 英语 88    # 英语学科，成绩88
张三 数学 85    # 数学学科，成绩85
李四 数学 92    # 数学学科，成绩92
```

**-k选项高级用法**：
```bash
# -k2,3 表示从第2字段到第3字段整体排序
sort -k2,3 data.txt

# -k1.2,1.5 表示第1字段的第2到第5个字符
sort -k1.2,1.5 data.txt
```

---

## 4. ⚙️ 分隔符与逆序排序


### 4.1 分隔符指定-t选项


**默认分隔符**：sort默认用**空格和制表符**作为字段分隔符

**-t选项作用**：指定**自定义分隔符**

```bash
# CSV格式数据 data.csv
姓名,年龄,部门
张三,25,技术部
李四,30,销售部
王五,22,人事部
```

**用逗号作分隔符排序**：
```bash
# 按第2字段（年龄）数值排序
sort -t',' -k2 -n data.csv
# 结果：
王五,22,人事部    # 年龄最小
张三,25,技术部
李四,30,销售部
姓名,年龄,部门    # 标题行也参与排序
```

**常见分隔符示例**：
```bash
# 冒号分隔（如/etc/passwd文件）
sort -t':' -k3 -n /etc/passwd

# 制表符分隔
sort -t$'\t' -k2 data.txt

# 空格分隔（默认，可省略-t）
sort -k2 data.txt
```

### 4.2 逆序排序-r选项


**-r选项含义**：把排序结果**颠倒过来**，从大到小排列

```bash
# 示例数据
echo -e "10\n5\n20" | sort -n
# 正序结果：5, 10, 20

echo -e "10\n5\n20" | sort -nr  
# 逆序结果：20, 10, 5
```

**实际应用场景**：
```bash
# 找出占用空间最大的文件
du -h * | sort -hr | head -5

# 按成绩从高到低排序
sort -k3 -nr students.txt
```

### 4.3 随机排序-R选项


**-R选项作用**：**随机打乱**行的顺序

```bash
# 随机排序，每次运行结果都不同
sort -R names.txt

# 实际用途：随机选择
sort -R candidates.txt | head -3  # 随机选3人
```

---

## 5. 🔄 去重与稳定排序


### 5.1 去重排序-u选项


**-u选项含义**：排序后**删除重复行**，只保留唯一的行

```bash
# 示例数据 emails.txt
zhang@company.com
li@company.com  
zhang@company.com  # 重复行
wang@company.com
li@company.com     # 重复行
```

**去重排序**：
```bash
sort -u emails.txt
# 结果：
li@company.com      # 只保留一份
wang@company.com
zhang@company.com   # 只保留一份
```

> 💡 **-u与uniq命令区别**  
> - `sort -u`：先排序，再去重
> - `uniq`：只去除**相邻**的重复行

**与uniq对比**：
```bash
# 数据：apple, banana, apple
echo -e "apple\nbanana\napple" | sort -u
# 结果：apple, banana （去重后只有2行）

echo -e "apple\nbanana\napple" | uniq  
# 结果：apple, banana, apple （没去重，因为两个apple不相邻）
```

### 5.2 稳定排序-s选项


**什么是稳定排序**：当两行内容**相同**时，保持它们在原文件中的**相对位置不变**

```bash
# 示例数据，第2个字段相同
张三 25 A部门
李四 25 B部门  
王五 30 C部门
```

**普通排序（可能不稳定）**：
```bash
sort -k2 -n data.txt
# 结果可能是：
张三 25 A部门
李四 25 B部门    # 或者这两行位置互换
王五 30 C部门
```

**稳定排序**：
```bash
sort -s -k2 -n data.txt  
# 结果保证：
张三 25 A部门    # 确保张三在李四前面（原始顺序）
李四 25 B部门
王五 30 C部门
```

> 🎯 **稳定排序的意义**  
> 在多轮排序中保持数据的原有关系，特别适用于多字段排序

---

## 6. ⚡ 高级排序选项


### 6.1 临时目录-T选项


**为什么需要临时目录**：处理大文件时，sort需要创建**临时文件**来辅助排序

**-T选项作用**：指定临时文件存放的**目录**

```bash
# 指定临时目录（通常选择空间大、速度快的磁盘）
sort -T /tmp/bigsort -k2 -n largefile.txt

# 指定多个临时目录
sort -T /tmp1 -T /tmp2 hugefile.txt
```

**应用场景**：
- 默认临时目录空间不足
- 想利用SSD提升排序速度
- 并行使用多个磁盘

### 6.2 内存限制选项


**-S选项**：指定sort使用的**最大内存**

```bash
# 限制使用最多1GB内存
sort -S 1G largefile.txt

# 限制使用500MB内存  
sort -S 500M data.txt
```

**为什么要限制内存**：
- 避免sort占用过多内存影响其他程序
- 在内存受限环境下确保稳定运行
- 控制系统负载

### 6.3 并行排序--parallel


**--parallel选项**：指定使用多少个**CPU核心**进行并行排序

```bash
# 使用4个CPU核心并行排序
sort --parallel=4 largefile.txt

# 自动使用所有可用CPU核心
sort --parallel=$(nproc) hugefile.txt
```

**性能提升效果**：
```
文件大小: 1GB
单线程: 60秒
4线程:   18秒  
8线程:   12秒
```

---

## 7. 📈 大文件排序优化策略


### 7.1 大文件排序挑战


**常见问题**：
- **内存不足**：文件比可用内存大
- **速度慢**：单线程处理大文件耗时长
- **磁盘IO**：频繁读写临时文件

### 7.2 优化策略组合


**完整优化命令示例**：
```bash
# 优化大文件排序的最佳实践
sort \
  --parallel=8 \           # 使用8个CPU核心
  -S 2G \                  # 限制内存使用2GB
  -T /ssd/tmp \           # 使用SSD作临时目录
  -k2 -n \                # 按第2字段数值排序
  largefile.txt \
  -o sorted_output.txt    # 输出到文件
```

### 7.3 性能监控与调优


**监控排序过程**：
```bash
# 监控sort进程
top -p $(pgrep sort)

# 监控磁盘IO  
iotop | grep sort

# 查看临时文件使用情况
ls -lh /tmp/sort*
```

**调优建议**：
```
┌─────────────────┬──────────────────┬─────────────────┐
│    文件大小      │     推荐配置      │      说明        │
├─────────────────┼──────────────────┼─────────────────┤
│    < 100MB      │   默认配置即可    │  无需特殊优化   │
├─────────────────┼──────────────────┼─────────────────┤
│   100MB-1GB     │ --parallel=4     │  适度并行      │
├─────────────────┼──────────────────┼─────────────────┤
│    1GB-10GB     │ -S 1G --parallel │ 限制内存+并行  │
├─────────────────┼──────────────────┼─────────────────┤
│     > 10GB      │ 全套优化策略     │ 所有选项都要用  │
└─────────────────┴──────────────────┴─────────────────┘
```

### 7.4 外部排序原理


**sort如何处理大文件**：
```
1. 分块读取文件到内存
   ┌─────────┐
   │ 原文件   │ → 读取100MB块
   └─────────┘

2. 对每个块进行排序
   ┌─────────┐    ┌─────────┐    ┌─────────┐
   │  块1排序 │    │  块2排序 │    │  块3排序 │
   └─────────┘    └─────────┘    └─────────┘

3. 归并排序所有块
   ┌─────────┐
   │ 最终结果 │
   └─────────┘
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本概念


```
🔸 sort本质：文本行排序工具，默认按字典序
🔸 -n选项：数值排序，处理数字时必用
🔸 -k选项：字段排序，指定按第几个字段排序
🔸 -t选项：指定字段分隔符
🔸 -r选项：逆序排序，从大到小
🔸 -u选项：去重排序，删除重复行
```

### 8.2 关键选项使用场景


| **选项** | **用途** | **典型场景** | **示例** |
|---------|---------|-------------|----------|
| `-n` | 数值排序 | 处理数字、分数 | `sort -n scores.txt` |
| `-k2` | 按字段排序 | CSV文件、结构化数据 | `sort -k2 -n data.txt` |
| `-t','` | 指定分隔符 | CSV、TSV文件 | `sort -t',' -k3 data.csv` |
| `-r` | 逆序排序 | 查找最大值 | `sort -nr numbers.txt` |
| `-u` | 去重排序 | 去除重复行 | `sort -u emails.txt` |
| `--parallel` | 并行排序 | 大文件处理 | `sort --parallel=4 big.txt` |

### 8.3 实际应用记忆口诀


**🎯 核心记忆**：
- **数字用-n，字段用-k**
- **分隔符用-t，逆序用-r**  
- **去重用-u，大文件要优化**
- **并行加内存，临时目录要指定**

### 8.4 常见错误避免


```
❌ 常见错误：
sort numbers.txt          # 数字按字典序，100 < 20
sort -k 2 data.txt        # 空格会导致-k失效

✅ 正确做法：
sort -n numbers.txt       # 数值排序
sort -k2 data.txt         # -k和数字连写
```

### 8.5 进阶应用技巧


**组合使用示例**：
```bash
# 统计词频并排序
cat text.txt | tr ' ' '\n' | sort | uniq -c | sort -nr

# 按多字段排序
sort -k1,1 -k2,2n data.txt  # 字段1字典序，字段2数值序

# 大文件优化排序
sort -S1G --parallel=4 -T/ssd/tmp -k3nr huge.txt
```

**核心理解**：
- sort是文本处理的基础工具
- 掌握字段排序是关键技能
- 大文件排序需要优化策略
- 与其他命令组合威力更大