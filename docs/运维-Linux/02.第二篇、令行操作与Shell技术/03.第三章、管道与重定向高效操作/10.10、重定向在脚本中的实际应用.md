---
title: 10ã€é‡å®šå‘åœ¨è„šæœ¬ä¸­çš„å®é™…åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [è„šæœ¬é‡å®šå‘åŸºç¡€æ¦‚å¿µ](#1-è„šæœ¬é‡å®šå‘åŸºç¡€æ¦‚å¿µ)
2. [è„šæœ¬æ—¥å¿—è®°å½•æœ€ä½³å®è·µ](#2-è„šæœ¬æ—¥å¿—è®°å½•æœ€ä½³å®è·µ)
3. [é”™è¯¯è¾“å‡ºåˆ†ç¦»å¤„ç†](#3-é”™è¯¯è¾“å‡ºåˆ†ç¦»å¤„ç†)
4. [é™é»˜æ‰§è¡Œä¸è¾“å‡ºæ§åˆ¶](#4-é™é»˜æ‰§è¡Œä¸è¾“å‡ºæ§åˆ¶)
5. [ä¸´æ—¶æ–‡ä»¶é‡å®šå‘æŠ€å·§](#5-ä¸´æ—¶æ–‡ä»¶é‡å®šå‘æŠ€å·§)
6. [é‡å®šå‘ä¸æƒé™æå‡](#6-é‡å®šå‘ä¸æƒé™æå‡)
7. [é‡å®šå‘åœ¨å¾ªç¯ä¸­çš„åº”ç”¨](#7-é‡å®šå‘åœ¨å¾ªç¯ä¸­çš„åº”ç”¨)
8. [ç”Ÿäº§ç¯å¢ƒé‡å®šå‘è§„èŒƒ](#8-ç”Ÿäº§ç¯å¢ƒé‡å®šå‘è§„èŒƒ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ è„šæœ¬é‡å®šå‘åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è„šæœ¬é‡å®šå‘

**ç®€å•ç†è§£**ï¼šè„šæœ¬é‡å®šå‘å°±æ˜¯åœ¨Shellè„šæœ¬ä¸­æ§åˆ¶ç¨‹åºè¾“å…¥è¾“å‡ºçš„æµå‘ï¼Œè®©æ•°æ®æŒ‰æˆ‘ä»¬éœ€è¦çš„æ–¹å¼æµåŠ¨ã€‚

```
æ­£å¸¸æƒ…å†µï¼šå‘½ä»¤è¾“å‡ºåˆ°å±å¹•
command â†’ å±å¹•æ˜¾ç¤º

é‡å®šå‘åï¼šå‘½ä»¤è¾“å‡ºåˆ°æ–‡ä»¶æˆ–å…¶ä»–åœ°æ–¹
command â†’ æ–‡ä»¶/è®¾å¤‡/å…¶ä»–ç¨‹åº
```

### 1.2 ä¸ºä»€ä¹ˆè„šæœ¬ä¸­éœ€è¦é‡å®šå‘

**å®é™…éœ€æ±‚åœºæ™¯**ï¼š
- **ğŸ“ ä¿å­˜æ—¥å¿—**ï¼šè„šæœ¬è¿è¡Œè¿‡ç¨‹è®°å½•åˆ°æ–‡ä»¶
- **ğŸš« å±è”½å™ªéŸ³**ï¼šéšè—ä¸é‡è¦çš„è¾“å‡ºä¿¡æ¯
- **âš ï¸ é”™è¯¯åˆ†ç¦»**ï¼šæ­£å¸¸è¾“å‡ºå’Œé”™è¯¯åˆ†å¼€å¤„ç†
- **ğŸ”„ æ•°æ®æµè½¬**ï¼šç¨‹åºé—´æ•°æ®ä¼ é€’

### 1.3 è„šæœ¬é‡å®šå‘çš„ä¸‰ä¸ªæ ¸å¿ƒæµ

```
æ ‡å‡†è¾“å…¥æµï¼ˆstdinï¼‰ï¼š  æ–‡ä»¶æè¿°ç¬¦ 0
æ ‡å‡†è¾“å‡ºæµï¼ˆstdoutï¼‰ï¼š æ–‡ä»¶æè¿°ç¬¦ 1
æ ‡å‡†é”™è¯¯æµï¼ˆstderrï¼‰ï¼š æ–‡ä»¶æè¿°ç¬¦ 2

å½¢è±¡ç†è§£ï¼š
stdin  â† æ•°æ®è¿›æ¥çš„ç®¡é“
stdout â†’ æ­£å¸¸ç»“æœå‡ºå»çš„ç®¡é“  
stderr â†’ é”™è¯¯ä¿¡æ¯å‡ºå»çš„ç®¡é“
```

### 1.4 åŸºæœ¬é‡å®šå‘ç¬¦å·é€Ÿè§ˆ

| ç¬¦å· | å«ä¹‰ | é€šä¿—è§£é‡Š |
|------|------|----------|
| `>` | **è¾“å‡ºé‡å®šå‘** | æŠŠç»“æœå†™åˆ°æ–‡ä»¶ï¼ˆè¦†ç›–ï¼‰ |
| `>>` | **è¿½åŠ é‡å®šå‘** | æŠŠç»“æœè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ |
| `<` | **è¾“å…¥é‡å®šå‘** | ä»æ–‡ä»¶è¯»å–æ•°æ® |
| `2>` | **é”™è¯¯é‡å®šå‘** | æŠŠé”™è¯¯ä¿¡æ¯å†™åˆ°æ–‡ä»¶ |
| `&>` | **å…¨éƒ¨é‡å®šå‘** | æŠŠæ‰€æœ‰è¾“å‡ºéƒ½å†™åˆ°æ–‡ä»¶ |

---

## 2. ğŸ“ è„šæœ¬æ—¥å¿—è®°å½•æœ€ä½³å®è·µ


### 2.1 æ—¥å¿—è®°å½•çš„é‡è¦æ€§

**ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—**ï¼š
- **ğŸ” é—®é¢˜æ’æŸ¥**ï¼šå‡ºé”™æ—¶èƒ½æ‰¾åˆ°åŸå› 
- **ğŸ“Š è¿è¡Œç›‘æ§**ï¼šäº†è§£è„šæœ¬æ‰§è¡Œæƒ…å†µ  
- **ğŸ“ˆ æ€§èƒ½åˆ†æ**ï¼šè®°å½•æ‰§è¡Œæ—¶é—´å’Œèµ„æºä½¿ç”¨
- **ğŸ›¡ï¸ å®‰å…¨å®¡è®¡**ï¼šè®°å½•æ“ä½œè½¨è¿¹

### 2.2 ç®€å•æ—¥å¿—è®°å½•å®ç°


**åŸºç¡€æ—¥å¿—è„šæœ¬**ï¼š
```bash
#!/bin/bash
# ç®€å•çš„æ—¥å¿—è®°å½•ç¤ºä¾‹

LOG_FILE="/var/log/myscript.log"

# è®°å½•å¼€å§‹æ—¶é—´
echo "[$(date)] è„šæœ¬å¼€å§‹æ‰§è¡Œ" >> "$LOG_FILE"

# æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ˆç¤ºä¾‹ï¼‰
echo "æ­£åœ¨å¤„ç†æ•°æ®..." >> "$LOG_FILE"
ls /etc >> "$LOG_FILE" 2>&1

# è®°å½•ç»“æŸæ—¶é—´
echo "[$(date)] è„šæœ¬æ‰§è¡Œå®Œæˆ" >> "$LOG_FILE"
```

### 2.3 å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—å‡½æ•°


**æ—¥å¿—å‡½æ•°å°è£…**ï¼š
```bash
#!/bin/bash

# æ—¥å¿—å‡½æ•° - è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³
log_info() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [INFO] $1" >> "$LOG_FILE"
}

log_error() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [ERROR] $1" >> "$LOG_FILE"
}

# ä½¿ç”¨ç¤ºä¾‹
LOG_FILE="/tmp/app.log"
log_info "åº”ç”¨ç¨‹åºå¯åŠ¨"
log_error "é…ç½®æ–‡ä»¶æœªæ‰¾åˆ°"
```

### 2.4 æŒ‰æ—¥æœŸåˆ†å‰²æ—¥å¿—


**æ—¥æœŸåˆ†å‰²æ—¥å¿—è„šæœ¬**ï¼š
```bash
#!/bin/bash

# æŒ‰æ—¥æœŸåˆ›å»ºæ—¥å¿—æ–‡ä»¶
TODAY=$(date '+%Y%m%d')
LOG_DIR="/var/log/myapp"
LOG_FILE="$LOG_DIR/app_$TODAY.log"

# ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨
mkdir -p "$LOG_DIR"

# ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå¹¶è®°å½•
{
    echo "=== è„šæœ¬å¼€å§‹ ==="
    echo "æ—¶é—´: $(date)"
    
    # æ‰§è¡Œå®é™…ä¸šåŠ¡
    backup_database() {
        echo "å¼€å§‹å¤‡ä»½æ•°æ®åº“..."
        # æ¨¡æ‹Ÿå¤‡ä»½æ“ä½œ
        sleep 2
        echo "æ•°æ®åº“å¤‡ä»½å®Œæˆ"
    }
    
    backup_database
    echo "=== è„šæœ¬ç»“æŸ ==="
    
} >> "$LOG_FILE" 2>&1
```

### 2.5 é«˜çº§æ—¥å¿—ç®¡ç†


**å¸¦æ—¥å¿—çº§åˆ«å’Œè½®è½¬çš„å®ç°**ï¼š
```bash
#!/bin/bash

LOG_DIR="/var/log/myapp"
LOG_FILE="$LOG_DIR/app.log"
MAX_LOG_SIZE=10485760  # 10MB

# æ—¥å¿—è½®è½¬æ£€æŸ¥
rotate_log() {
    if [[ -f "$LOG_FILE" ]] && [[ $(stat -f%z "$LOG_FILE" 2>/dev/null || stat -c%s "$LOG_FILE") -gt $MAX_LOG_SIZE ]]; then
        mv "$LOG_FILE" "$LOG_FILE.$(date +%Y%m%d_%H%M%S)"
    fi
}

# ç»Ÿä¸€æ—¥å¿—å‡½æ•°
write_log() {
    local level=$1
    local message=$2
    rotate_log
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [$level] $message" >> "$LOG_FILE"
}

# ä½¿ç”¨ç¤ºä¾‹
write_log "INFO" "ç³»ç»Ÿæ£€æŸ¥å¼€å§‹"
write_log "WARNING" "ç£ç›˜ç©ºé—´ä¸è¶³"
write_log "ERROR" "è¿æ¥æ•°æ®åº“å¤±è´¥"
```

---

## 3. âš ï¸ é”™è¯¯è¾“å‡ºåˆ†ç¦»å¤„ç†


### 3.1 ä¸ºä»€ä¹ˆè¦åˆ†ç¦»é”™è¯¯è¾“å‡º

**å®é™…åœºæ™¯ç†è§£**ï¼š
```
æ··åˆè¾“å‡ºçš„é—®é¢˜ï¼š
$ some_command > output.txt
æ­£å¸¸ç»“æœå†™å…¥æ–‡ä»¶ï¼Œä½†é”™è¯¯ä¿¡æ¯è¿˜æ˜¯æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå¾ˆæ··ä¹±

åˆ†ç¦»åçš„å¥½å¤„ï¼š
$ some_command > output.txt 2> error.txt  
æ­£å¸¸ç»“æœ â†’ output.txt
é”™è¯¯ä¿¡æ¯ â†’ error.txt
å„è‡ªå¤„ç†ï¼Œæ¸…æ™°æ˜äº†
```

### 3.2 åŸºæœ¬é”™è¯¯åˆ†ç¦»æŠ€æœ¯


**æ ‡å‡†çš„é”™è¯¯åˆ†ç¦»æ–¹æ³•**ï¼š
```bash
#!/bin/bash

# æ–¹æ³•1ï¼šåˆ†åˆ«é‡å®šå‘
command > success.log 2> error.log

# æ–¹æ³•2ï¼šé”™è¯¯å’Œè¾“å‡ºåˆ°ä¸åŒåœ°æ–¹
command > /dev/null 2> error.log    # åªä¿å­˜é”™è¯¯
command > output.log 2>&1           # é”™è¯¯å’Œè¾“å‡ºåˆå¹¶
```

### 3.3 å®é™…çš„é”™è¯¯å¤„ç†è„šæœ¬


**æ–‡ä»¶å¤„ç†è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash

WORK_DIR="/tmp/batch_process"
OUTPUT_LOG="$WORK_DIR/success.log"
ERROR_LOG="$WORK_DIR/errors.log"

# ç¡®ä¿å·¥ä½œç›®å½•å­˜åœ¨
mkdir -p "$WORK_DIR"

# æ‰¹é‡å¤„ç†æ–‡ä»¶çš„å‡½æ•°
process_files() {
    local file_pattern="*.txt"
    local success_count=0
    local error_count=0
    
    for file in $file_pattern; do
        if [[ -f "$file" ]]; then
            # å¤„ç†æ–‡ä»¶ï¼Œåˆ†ç¦»è¾“å‡ºå’Œé”™è¯¯
            if process_single_file "$file" >> "$OUTPUT_LOG" 2>> "$ERROR_LOG"; then
                ((success_count++))
                echo "âœ… å¤„ç†æˆåŠŸ: $file"
            else
                ((error_count++))
                echo "âŒ å¤„ç†å¤±è´¥: $file"
            fi
        fi
    done
    
    # è¾“å‡ºç»Ÿè®¡ç»“æœ
    echo "å¤„ç†å®Œæˆ - æˆåŠŸ: $success_count, å¤±è´¥: $error_count"
}

# å•æ–‡ä»¶å¤„ç†å‡½æ•°
process_single_file() {
    local file=$1
    echo "[$(date)] å¼€å§‹å¤„ç†: $file"
    
    # æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†æ“ä½œ
    if grep -q "error" "$file"; then
        echo "å‘ç°é”™è¯¯å†…å®¹åœ¨æ–‡ä»¶: $file" >&2
        return 1
    else
        echo "æ–‡ä»¶å¤„ç†æˆåŠŸ: $file"
        return 0
    fi
}

# æ‰§è¡Œå¤„ç†
process_files
```

### 3.4 æ¡ä»¶é”™è¯¯å¤„ç†


**æ ¹æ®é”™è¯¯ç±»å‹ä¸åŒå¤„ç†**ï¼š
```bash
#!/bin/bash

# æ™ºèƒ½é”™è¯¯å¤„ç†å‡½æ•°
handle_command_with_errors() {
    local cmd="$1"
    local temp_error="/tmp/cmd_error.$$"
    
    # æ‰§è¡Œå‘½ä»¤ï¼Œæ•è·é”™è¯¯
    if $cmd 2> "$temp_error"; then
        echo "âœ… å‘½ä»¤æ‰§è¡ŒæˆåŠŸ"
        rm -f "$temp_error"
        return 0
    else
        local error_content=$(cat "$temp_error")
        echo "âŒ å‘½ä»¤æ‰§è¡Œå¤±è´¥"
        
        # æ ¹æ®é”™è¯¯ç±»å‹åˆ†ç±»å¤„ç†
        case "$error_content" in
            *"Permission denied"*)
                echo "ğŸ”’ æƒé™é”™è¯¯ï¼Œå°è¯•ä½¿ç”¨sudo"
                sudo $cmd
                ;;
            *"No such file"*)
                echo "ğŸ“ æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯"
                echo "é”™è¯¯è¯¦æƒ…: $error_content"
                ;;
            *"Network"*)
                echo "ğŸŒ ç½‘ç»œè¿æ¥é”™è¯¯"
                echo "è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"
                ;;
            *)
                echo "â“ æœªçŸ¥é”™è¯¯"
                echo "é”™è¯¯è¯¦æƒ…: $error_content"
                ;;
        esac
        
        rm -f "$temp_error"
        return 1
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
handle_command_with_errors "wget https://example.com/file.txt"
```

---

## 4. ğŸ”‡ é™é»˜æ‰§è¡Œä¸è¾“å‡ºæ§åˆ¶


### 4.1 ä»€ä¹ˆæ˜¯é™é»˜æ‰§è¡Œ

**é€šä¿—ç†è§£**ï¼šé™é»˜æ‰§è¡Œå°±æ˜¯è®©ç¨‹åº"é—·å£°å¹²æ´»"ï¼Œä¸åœ¨å±å¹•ä¸Šæ˜¾ç¤ºè¾“å‡ºä¿¡æ¯ï¼Œé¿å…å¹²æ‰°ç”¨æˆ·æˆ–å…¶ä»–ç¨‹åºã€‚

```
æ™®é€šæ‰§è¡Œï¼š
$ ls -la
drwxr-xr-x  5 user user 4096 Jan 13 10:30 .
drwxr-xr-x  3 user user 4096 Jan 13 10:25 ..
(ä¸€å †è¾“å‡ºä¿¡æ¯)

é™é»˜æ‰§è¡Œï¼š
$ ls -la > /dev/null
(ä»€ä¹ˆéƒ½ä¸æ˜¾ç¤ºï¼Œä½†å‘½ä»¤ç¡®å®æ‰§è¡Œäº†)
```

### 4.2 åŸºæœ¬é™é»˜æŠ€æœ¯


**å¸¸ç”¨é™é»˜æ–¹æ³•**ï¼š
```bash
#!/bin/bash

# æ–¹æ³•1ï¼šé‡å®šå‘åˆ°é»‘æ´è®¾å¤‡
command > /dev/null          # éšè—æ­£å¸¸è¾“å‡º
command 2> /dev/null         # éšè—é”™è¯¯è¾“å‡º  
command > /dev/null 2>&1     # éšè—æ‰€æœ‰è¾“å‡º

# æ–¹æ³•2ï¼šä½¿ç”¨silentå‡½æ•°
silent() {
    "$@" > /dev/null 2>&1
}

# ä½¿ç”¨ç¤ºä¾‹
silent wget https://example.com/large-file.zip
echo "æ–‡ä»¶ä¸‹è½½å®Œæˆï¼ˆé™é»˜æ¨¡å¼ï¼‰"
```

### 4.3 æ¡ä»¶é™é»˜æ‰§è¡Œ


**æ ¹æ®éœ€è¦æ§åˆ¶è¾“å‡º**ï¼š
```bash
#!/bin/bash

# æ ¹æ®å‚æ•°å†³å®šæ˜¯å¦é™é»˜
VERBOSE=false

# è§£æå‘½ä»¤è¡Œå‚æ•°
while [[ $# -gt 0 ]]; do
    case $1 in
        -v|--verbose)
            VERBOSE=true
            shift
            ;;
        *)
            shift
            ;;
    esac
done

# æ™ºèƒ½æ‰§è¡Œå‡½æ•°
smart_execute() {
    local cmd="$*"
    
    if [[ "$VERBOSE" == "true" ]]; then
        # è¯¦ç»†æ¨¡å¼ï¼šæ˜¾ç¤ºæ‰€æœ‰è¾“å‡º
        echo "ğŸ” æ‰§è¡Œå‘½ä»¤: $cmd"
        eval "$cmd"
    else
        # é™é»˜æ¨¡å¼ï¼šéšè—è¾“å‡ºï¼Œåªæ˜¾ç¤ºç»“æœ
        if eval "$cmd" > /dev/null 2>&1; then
            echo "âœ… æ“ä½œæˆåŠŸ"
        else
            echo "âŒ æ“ä½œå¤±è´¥"
            return 1
        fi
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
smart_execute "apt update"
smart_execute "systemctl restart nginx"
```

### 4.4 éƒ¨åˆ†é™é»˜æ§åˆ¶


**é€‰æ‹©æ€§è¾“å‡ºæ§åˆ¶**ï¼š
```bash
#!/bin/bash

# ä¿ç•™é‡è¦ä¿¡æ¯ï¼Œéšè—å†—ä½™è¾“å‡º
install_software() {
    local package=$1
    
    echo "ğŸ“¦ å¼€å§‹å®‰è£…: $package"
    
    # éšè—å®‰è£…è¿‡ç¨‹çš„è¯¦ç»†è¾“å‡ºï¼Œä½†ä¿ç•™é”™è¯¯ä¿¡æ¯
    if apt install -y "$package" > /tmp/install.log 2>&1; then
        echo "âœ… $package å®‰è£…æˆåŠŸ"
    else
        echo "âŒ $package å®‰è£…å¤±è´¥"
        echo "é”™è¯¯ä¿¡æ¯:"
        tail -5 /tmp/install.log  # æ˜¾ç¤ºæœ€å5è¡Œé”™è¯¯ä¿¡æ¯
        return 1
    fi
}

# ç³»ç»Ÿç»´æŠ¤è„šæœ¬
system_maintenance() {
    echo "ğŸ”§ å¼€å§‹ç³»ç»Ÿç»´æŠ¤..."
    
    # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼ˆé™é»˜ï¼‰
    echo "ğŸ“ æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨..."
    apt update > /dev/null 2>&1
    
    # æ¸…ç†ç³»ç»Ÿï¼ˆæ˜¾ç¤ºé‡è¦ä¿¡æ¯ï¼‰
    echo "ğŸ§¹ æ¸…ç†ç³»ç»Ÿåƒåœ¾..."
    apt autoremove -y 2>&1 | grep -E "(removed|freed)"
    
    echo "âœ¨ ç³»ç»Ÿç»´æŠ¤å®Œæˆ"
}
```

---

## 5. ğŸ“ ä¸´æ—¶æ–‡ä»¶é‡å®šå‘æŠ€å·§


### 5.1 ä¸´æ—¶æ–‡ä»¶çš„ä½œç”¨

**ä¸ºä»€ä¹ˆéœ€è¦ä¸´æ—¶æ–‡ä»¶**ï¼š
- **ğŸ”„ æ•°æ®ä¸­è½¬**ï¼šç¨‹åºé—´ä¼ é€’å¤§é‡æ•°æ®
- **ğŸ’¾ ä¸´æ—¶å­˜å‚¨**ï¼šå¤„ç†è¿‡ç¨‹ä¸­æš‚å­˜ç»“æœ
- **ğŸ” è°ƒè¯•åˆ†æ**ï¼šä¿å­˜ä¸­é—´çŠ¶æ€ä¾¿äºæ’æŸ¥
- **ğŸ›¡ï¸ å®‰å…¨éš”ç¦»**ï¼šé¿å…ç›´æ¥æ“ä½œé‡è¦æ–‡ä»¶

### 5.2 å®‰å…¨çš„ä¸´æ—¶æ–‡ä»¶åˆ›å»º


**åˆ›å»ºå”¯ä¸€ä¸´æ—¶æ–‡ä»¶**ï¼š
```bash
#!/bin/bash

# æ–¹æ³•1ï¼šä½¿ç”¨mktempåˆ›å»ºä¸´æ—¶æ–‡ä»¶
TEMP_FILE=$(mktemp)
echo "ä¸´æ—¶æ–‡ä»¶è·¯å¾„: $TEMP_FILE"

# æ–¹æ³•2ï¼šä½¿ç”¨è¿›ç¨‹IDåˆ›å»ºå”¯ä¸€æ–‡ä»¶å
TEMP_DIR="/tmp"
TEMP_FILE="$TEMP_DIR/script_$$_$(date +%s).tmp"

# æ–¹æ³•3ï¼šåˆ›å»ºä¸´æ—¶ç›®å½•
TEMP_DIR=$(mktemp -d)
TEMP_FILE="$TEMP_DIR/data.txt"

# ä½¿ç”¨å®Œåæ¸…ç†
cleanup() {
    rm -f "$TEMP_FILE"
    [[ -d "$TEMP_DIR" ]] && rm -rf "$TEMP_DIR"
}
trap cleanup EXIT  # è„šæœ¬é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†
```

### 5.3 ä¸´æ—¶æ–‡ä»¶æ•°æ®å¤„ç†


**ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å¤„ç†æ•°æ®æµ**ï¼š
```bash
#!/bin/bash

# æ•°æ®å¤„ç†ç®¡é“ç¤ºä¾‹
process_large_dataset() {
    local input_file=$1
    local output_file=$2
    
    # åˆ›å»ºä¸´æ—¶æ–‡ä»¶
    local temp1=$(mktemp)
    local temp2=$(mktemp)
    
    echo "ğŸ”„ å¼€å§‹å¤„ç†æ•°æ®: $input_file"
    
    # ç¬¬ä¸€æ­¥ï¼šæ•°æ®æ¸…æ´—
    echo "ğŸ“ æ­¥éª¤1: æ•°æ®æ¸…æ´—"
    grep -v "^#" "$input_file" > "$temp1"  # å»é™¤æ³¨é‡Šè¡Œ
    
    # ç¬¬äºŒæ­¥ï¼šæ•°æ®æ’åº
    echo "ğŸ“Š æ­¥éª¤2: æ•°æ®æ’åº"  
    sort "$temp1" > "$temp2"
    
    # ç¬¬ä¸‰æ­¥ï¼šå»é‡
    echo "ğŸ” æ­¥éª¤3: æ•°æ®å»é‡"
    uniq "$temp2" > "$output_file"
    
    # ç»Ÿè®¡ç»“æœ
    local original_lines=$(wc -l < "$input_file")
    local final_lines=$(wc -l < "$output_file")
    
    echo "âœ… å¤„ç†å®Œæˆ"
    echo "   åŸå§‹è¡Œæ•°: $original_lines"
    echo "   æœ€ç»ˆè¡Œæ•°: $final_lines"
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f "$temp1" "$temp2"
}

# ä½¿ç”¨ç¤ºä¾‹
process_large_dataset "raw_data.txt" "clean_data.txt"
```

### 5.4 ä¸´æ—¶æ–‡ä»¶é‡å®šå‘æ¨¡å¼


**å¤æ‚é‡å®šå‘åœºæ™¯**ï¼š
```bash
#!/bin/bash

# å¤šé˜¶æ®µå¤„ç†è„šæœ¬
multi_stage_process() {
    local base_name="process_$$"
    local stage1_out="/tmp/${base_name}_stage1.out"
    local stage1_err="/tmp/${base_name}_stage1.err"
    local stage2_out="/tmp/${base_name}_stage2.out"
    local final_out="/tmp/${base_name}_final.out"
    
    echo "ğŸš€ å¼€å§‹å¤šé˜¶æ®µå¤„ç†..."
    
    # é˜¶æ®µ1ï¼šåˆå§‹å¤„ç†
    {
        echo "=== é˜¶æ®µ1å¼€å§‹ ==="
        echo "å¤„ç†æ—¶é—´: $(date)"
        find /var/log -name "*.log" -type f
        echo "=== é˜¶æ®µ1ç»“æŸ ==="
    } > "$stage1_out" 2> "$stage1_err"
    
    # æ£€æŸ¥é˜¶æ®µ1æ˜¯å¦æˆåŠŸ
    if [[ -s "$stage1_err" ]]; then
        echo "âŒ é˜¶æ®µ1å¤„ç†å‡ºé”™:"
        cat "$stage1_err"
        return 1
    fi
    
    # é˜¶æ®µ2ï¼šæ•°æ®åˆ†æ
    {
        echo "=== é˜¶æ®µ2å¼€å§‹ ==="
        while read -r logfile; do
            if [[ -f "$logfile" ]]; then
                echo "åˆ†ææ–‡ä»¶: $logfile"
                wc -l "$logfile"
            fi
        done < "$stage1_out"
        echo "=== é˜¶æ®µ2ç»“æŸ ==="
    } > "$stage2_out"
    
    # æœ€ç»ˆæ±‡æ€»
    {
        echo "=== æœ€ç»ˆæŠ¥å‘Š ==="
        echo "ç”Ÿæˆæ—¶é—´: $(date)"
        echo ""
        cat "$stage2_out"
    } > "$final_out"
    
    echo "âœ… å¤„ç†å®Œæˆï¼Œç»“æœä¿å­˜åˆ°: $final_out"
    
    # å¯é€‰ï¼šæ¸…ç†ä¸­é—´æ–‡ä»¶
    # rm -f "$stage1_out" "$stage1_err" "$stage2_out"
}
```

---

## 6. ğŸ” é‡å®šå‘ä¸æƒé™æå‡


### 6.1 æƒé™é—®é¢˜çš„ç†è§£

**å¸¸è§æƒé™é‡å®šå‘é—®é¢˜**ï¼š
```bash
# è¿™æ ·ä¼šå¤±è´¥ï¼
sudo echo "content" > /etc/some-config

# ä¸ºä»€ä¹ˆå¤±è´¥ï¼Ÿ
# sudoåªä½œç”¨äºechoå‘½ä»¤
# é‡å®šå‘(>)æ˜¯shellæ“ä½œï¼Œä»ç„¶ä»¥æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œ
# æ‰€ä»¥æ— æ³•å†™å…¥éœ€è¦rootæƒé™çš„æ–‡ä»¶
```

### 6.2 æ­£ç¡®çš„æƒé™æå‡æ–¹æ³•


**æ–¹æ³•ä¸€ï¼šä½¿ç”¨sudo sh -c**ï¼š
```bash
#!/bin/bash

# æ­£ç¡®çš„æ–¹å¼
sudo sh -c 'echo "new content" > /etc/important-config'

# æˆ–è€…ä½¿ç”¨å‡½æ•°å°è£…
write_with_sudo() {
    local content="$1"
    local file="$2"
    sudo sh -c "echo '$content' > '$file'"
}

# ä½¿ç”¨ç¤ºä¾‹
write_with_sudo "server_name example.com;" "/etc/nginx/sites-available/default"
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨teeå‘½ä»¤**ï¼š
```bash
#!/bin/bash

# ä½¿ç”¨teeè§£å†³æƒé™é—®é¢˜
echo "log_level = debug" | sudo tee /etc/myapp/config.conf > /dev/null

# teeè¿½åŠ æ¨¡å¼
echo "new_option = value" | sudo tee -a /etc/myapp/config.conf > /dev/null

# å°è£…æˆå‡½æ•°
sudo_write() {
    local content="$1"
    local file="$2"
    local mode="$3"  # "overwrite" æˆ– "append"
    
    if [[ "$mode" == "append" ]]; then
        echo "$content" | sudo tee -a "$file" > /dev/null
    else
        echo "$content" | sudo tee "$file" > /dev/null
    fi
    
    echo "âœ… å·²å†™å…¥ $file"
}

# ä½¿ç”¨ç¤ºä¾‹
sudo_write "# Configuration updated on $(date)" "/etc/hosts" "append"
```

### 6.3 å¤æ‚æƒé™åœºæ™¯å¤„ç†


**æ‰¹é‡é…ç½®æ–‡ä»¶ä¿®æ”¹**ï¼š
```bash
#!/bin/bash

# ç³»ç»Ÿé…ç½®æ›´æ–°è„šæœ¬
update_system_configs() {
    echo "ğŸ”§ å¼€å§‹æ›´æ–°ç³»ç»Ÿé…ç½®..."
    
    # å¤‡ä»½åŸé…ç½®
    backup_configs() {
        local backup_dir="/tmp/config_backup_$(date +%Y%m%d_%H%M%S)"
        sudo mkdir -p "$backup_dir"
        
        local configs=("/etc/nginx/nginx.conf" "/etc/ssh/sshd_config" "/etc/hosts")
        
        for config in "${configs[@]}"; do
            if [[ -f "$config" ]]; then
                sudo cp "$config" "$backup_dir/"
                echo "ğŸ“‹ å¤‡ä»½: $config"
            fi
        done
        
        echo "ğŸ’¾ å¤‡ä»½ç›®å½•: $backup_dir"
    }
    
    # æ›´æ–°é…ç½®
    update_nginx_config() {
        echo "ğŸŒ æ›´æ–°Nginxé…ç½®..."
        
        # ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å‡†å¤‡æ–°é…ç½®
        local temp_config=$(mktemp)
        cat > "$temp_config" << 'EOF'
# Nginxæ€§èƒ½ä¼˜åŒ–é…ç½®
worker_processes auto;
worker_connections 1024;

# å¯ç”¨gzipå‹ç¼©
gzip on;
gzip_types text/plain text/css application/json application/javascript;
EOF
        
        # åŸå­æ€§æ›¿æ¢é…ç½®æ–‡ä»¶
        if sudo cp "$temp_config" /etc/nginx/conf.d/performance.conf; then
            echo "âœ… Nginxé…ç½®æ›´æ–°æˆåŠŸ"
            sudo nginx -t && echo "âœ… é…ç½®è¯­æ³•æ£€æŸ¥é€šè¿‡"
        else
            echo "âŒ Nginxé…ç½®æ›´æ–°å¤±è´¥"
        fi
        
        rm -f "$temp_config"
    }
    
    # æ‰§è¡Œæ›´æ–°
    backup_configs
    update_nginx_config
}
```

---

## 7. ğŸ”„ é‡å®šå‘åœ¨å¾ªç¯ä¸­çš„åº”ç”¨


### 7.1 å¾ªç¯é‡å®šå‘çš„åŸºæœ¬æ¦‚å¿µ

**ä¸ºä»€ä¹ˆå¾ªç¯ä¸­éœ€è¦é‡å®šå‘**ï¼š
- **ğŸ“Š æ‰¹é‡æ•°æ®å¤„ç†**ï¼šå¾ªç¯å¤„ç†å¤§é‡æ–‡ä»¶æˆ–æ•°æ®
- **ğŸ“ ç´¯ç§¯æ—¥å¿—è®°å½•**ï¼šå¾ªç¯è¿‡ç¨‹ä¸­æŒç»­è®°å½•ä¿¡æ¯
- **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…é¢‘ç¹æ‰“å¼€å…³é—­æ–‡ä»¶
- **ğŸ” è¿›åº¦ç›‘æ§**ï¼šå®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦

### 7.2 å¾ªç¯å¤–éƒ¨é‡å®šå‘


**æ•´ä¸ªå¾ªç¯çš„è¾“å‡ºé‡å®šå‘**ï¼š
```bash
#!/bin/bash

# æ–¹æ³•1ï¼šæ•´ä¸ªå¾ªç¯é‡å®šå‘åˆ°æ–‡ä»¶
{
    echo "å¼€å§‹æ‰¹é‡å¤„ç†..."
    echo "æ—¶é—´: $(date)"
    
    for file in *.txt; do
        if [[ -f "$file" ]]; then
            echo "å¤„ç†æ–‡ä»¶: $file"
            wc -l "$file"
            echo "---"
        fi
    done
    
    echo "å¤„ç†å®Œæˆ: $(date)"
} > batch_process.log

echo "âœ… æ‰¹é‡å¤„ç†å®Œæˆï¼Œæ—¥å¿—ä¿å­˜åˆ° batch_process.log"
```

### 7.3 å¾ªç¯å†…éƒ¨é‡å®šå‘


**å¾ªç¯å†…æ¯æ¬¡è¿­ä»£çš„é‡å®šå‘**ï¼š
```bash
#!/bin/bash

# æ–‡ä»¶æ‰¹å¤„ç†è„šæœ¬
batch_file_processor() {
    local input_dir="/path/to/input"
    local output_dir="/path/to/output"
    local log_file="/tmp/batch_process.log"
    
    mkdir -p "$output_dir"
    
    # æ¸…ç©ºæ—¥å¿—æ–‡ä»¶
    > "$log_file"
    
    local count=0
    local success=0
    local failed=0
    
    for file in "$input_dir"/*.txt; do
        if [[ -f "$file" ]]; then
            ((count++))
            local filename=$(basename "$file")
            local output_file="$output_dir/processed_$filename"
            
            echo "[$count] å¤„ç†æ–‡ä»¶: $filename" | tee -a "$log_file"
            
            # å•ä¸ªæ–‡ä»¶å¤„ç†ï¼Œåˆ†åˆ«è®°å½•æˆåŠŸå’Œå¤±è´¥
            if process_single_file "$file" > "$output_file" 2>> "$log_file"; then
                ((success++))
                echo "  âœ… æˆåŠŸ" | tee -a "$log_file"
            else
                ((failed++))
                echo "  âŒ å¤±è´¥" | tee -a "$log_file"
            fi
        fi
    done
    
    # è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
    {
        echo ""
        echo "=== å¤„ç†ç»Ÿè®¡ ==="
        echo "æ€»æ–‡ä»¶æ•°: $count"
        echo "æˆåŠŸ: $success"
        echo "å¤±è´¥: $failed"
        echo "å®Œæˆæ—¶é—´: $(date)"
    } | tee -a "$log_file"
}

# å•æ–‡ä»¶å¤„ç†å‡½æ•°
process_single_file() {
    local file="$1"
    
    # æ¨¡æ‹Ÿå¤„ç†æ“ä½œ
    echo "å¼€å§‹å¤„ç†: $(basename "$file")"
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
    if [[ ! -s "$file" ]]; then
        echo "é”™è¯¯: æ–‡ä»¶ä¸ºç©º" >&2
        return 1
    fi
    
    # æ¨¡æ‹Ÿæ•°æ®å¤„ç†
    sed 's/old/new/g' "$file"
    echo "å¤„ç†å®Œæˆ: $(basename "$file")"
}
```

### 7.4 å¾ªç¯è¿›åº¦ç›‘æ§


**å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦**ï¼š
```bash
#!/bin/bash

# å¸¦è¿›åº¦æ˜¾ç¤ºçš„å¾ªç¯å¤„ç†
process_with_progress() {
    local items=("file1.txt" "file2.txt" "file3.txt" "data.csv" "config.json")
    local total=${#items[@]}
    local current=0
    
    echo "ğŸš€ å¼€å§‹å¤„ç† $total ä¸ªé¡¹ç›®..."
    
    for item in "${items[@]}"; do
        ((current++))
        
        # è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
        local percent=$((current * 100 / total))
        
        # è¿›åº¦æ¡æ˜¾ç¤º
        local bar_length=20
        local filled=$((percent * bar_length / 100))
        local bar=""
        
        for ((i=0; i<filled; i++)); do bar+="â–ˆ"; done
        for ((i=filled; i<bar_length; i++)); do bar+="â–‘"; done
        
        # åŒæ—¶è¾“å‡ºåˆ°å±å¹•å’Œæ—¥å¿—
        {
            printf "\rè¿›åº¦: [%s] %3d%% (%d/%d) å¤„ç†: %s" "$bar" "$percent" "$current" "$total" "$item"
            
            # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
            sleep 1
            
            # å¤„ç†å®Œæˆåæ¢è¡Œå¹¶è®°å½•åˆ°æ—¥å¿—
            if [[ $current -eq $total ]]; then
                echo ""  # æœ€åä¸€ä¸ªé¡¹ç›®åæ¢è¡Œ
            fi
        } | tee -a process.log
    done
    
    echo "âœ… æ‰€æœ‰é¡¹ç›®å¤„ç†å®Œæˆï¼"
}

process_with_progress
```

### 7.5 å¹¶è¡Œå¾ªç¯é‡å®šå‘


**å¾ªç¯ä¸­å¹¶è¡Œå¤„ç†çš„é‡å®šå‘**ï¼š
```bash
#!/bin/bash

# å¹¶è¡Œå¤„ç†withé‡å®šå‘
parallel_process() {
    local max_jobs=4  # æœ€å¤§å¹¶è¡Œæ•°
    local job_count=0
    local pids=()
    
    echo "ğŸ”„ å¼€å§‹å¹¶è¡Œå¤„ç†ï¼ˆæœ€å¤§å¹¶è¡Œæ•°: $max_jobsï¼‰"
    
    for file in *.log; do
        if [[ -f "$file" ]]; then
            # ç­‰å¾…ifå·²è¾¾åˆ°æœ€å¤§å¹¶è¡Œæ•°
            while [[ ${#pids[@]} -ge $max_jobs ]]; do
                # æ£€æŸ¥å·²å®Œæˆçš„ä»»åŠ¡
                for i in "${!pids[@]}"; do
                    if ! kill -0 "${pids[i]}" 2>/dev/null; then
                        wait "${pids[i]}"
                        unset 'pids[i]'
                        pids=("${pids[@]}")  # é‡æ–°ç´¢å¼•æ•°ç»„
                        break
                    fi
                done
                sleep 0.1
            done
            
            # å¯åŠ¨æ–°çš„åå°ä»»åŠ¡
            (
                local output_file="processed_$(basename "$file")"
                local log_file="process_$(basename "$file" .log).log"
                
                echo "[$(date)] å¼€å§‹å¤„ç†: $file" > "$log_file"
                
                # å®é™…å¤„ç†æ“ä½œ
                if analyze_log_file "$file" > "$output_file" 2>> "$log_file"; then
                    echo "[$(date)] âœ… å®Œæˆ: $file" >> "$log_file"
                else
                    echo "[$(date)] âŒ å¤±è´¥: $file" >> "$log_file"
                fi
            ) &
            
            pids+=($!)
            ((job_count++))
            echo "å¯åŠ¨ä»»åŠ¡ $job_count: $file (PID: $!)"
        fi
    done
    
    # ç­‰å¾…æ‰€æœ‰åå°ä»»åŠ¡å®Œæˆ
    for pid in "${pids[@]}"; do
        wait "$pid"
    done
    
    echo "âœ… æ‰€æœ‰å¹¶è¡Œä»»åŠ¡å®Œæˆ"
}

# æ—¥å¿—æ–‡ä»¶åˆ†æå‡½æ•°
analyze_log_file() {
    local file="$1"
    echo "åˆ†ææ–‡ä»¶: $file"
    
    # ç»Ÿè®¡å„ç§æ—¥å¿—çº§åˆ«
    echo "é”™è¯¯æ•°é‡: $(grep -c "ERROR" "$file")"
    echo "è­¦å‘Šæ•°é‡: $(grep -c "WARN" "$file")"
    echo "ä¿¡æ¯æ•°é‡: $(grep -c "INFO" "$file")"
}
```

---

## 8. ğŸ­ ç”Ÿäº§ç¯å¢ƒé‡å®šå‘è§„èŒƒ


### 8.1 ç”Ÿäº§ç¯å¢ƒçš„ç‰¹æ®Šè¦æ±‚

**ç”Ÿäº§ç¯å¢ƒé‡å®šå‘éœ€è¦è€ƒè™‘**ï¼š
- **ğŸ›¡ï¸ å®‰å…¨æ€§**ï¼šé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²
- **ğŸ“Š ç›‘æ§æ€§**ï¼šä¾¿äºè¿ç»´ç›‘æ§å’Œæ•…éšœæ’æŸ¥
- **âš¡ æ€§èƒ½**ï¼šä¸å½±å“ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
- **ğŸ”„ ç»´æŠ¤æ€§**ï¼šæ—¥å¿—è½®è½¬å’Œæ¸…ç†
- **ğŸš¨ å‘Šè­¦**ï¼šå¼‚å¸¸æƒ…å†µåŠæ—¶é€šçŸ¥

### 8.2 æ ‡å‡†åŒ–æ—¥å¿—æ ¼å¼


**ç”Ÿäº§çº§æ—¥å¿—è®°å½•è§„èŒƒ**ï¼š
```bash
#!/bin/bash

# ç”Ÿäº§ç¯å¢ƒæ—¥å¿—é…ç½®
SCRIPT_NAME=$(basename "$0" .sh)
LOG_DIR="/var/log/scripts"
LOG_FILE="$LOG_DIR/${SCRIPT_NAME}.log"
ERROR_LOG="$LOG_DIR/${SCRIPT_NAME}_error.log"
PID_FILE="/var/run/${SCRIPT_NAME}.pid"

# ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨
sudo mkdir -p "$LOG_DIR"
sudo chown "$USER:$USER" "$LOG_DIR"

# æ£€æŸ¥æ˜¯å¦å·²æœ‰å®ä¾‹è¿è¡Œ
check_running() {
    if [[ -f "$PID_FILE" ]]; then
        local pid=$(cat "$PID_FILE")
        if kill -0 "$pid" 2>/dev/null; then
            echo "âŒ è„šæœ¬å·²åœ¨è¿è¡Œ (PID: $pid)"
            exit 1
        else
            rm -f "$PID_FILE"
        fi
    fi
    echo $$ > "$PID_FILE"
}

# æ ‡å‡†æ—¥å¿—å‡½æ•°
log_message() {
    local level="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local hostname=$(hostname)
    
    # æ ‡å‡†æ ¼å¼ï¼šæ—¶é—´æˆ³|ä¸»æœºå|çº§åˆ«|è„šæœ¬å|æ¶ˆæ¯
    local log_entry="$timestamp|$hostname|$level|$SCRIPT_NAME|$message"
    
    case "$level" in
        ERROR)
            echo "$log_entry" >> "$ERROR_LOG"
            echo "$log_entry" >> "$LOG_FILE"
            ;;
        *)
            echo "$log_entry" >> "$LOG_FILE"
            ;;
    esac
    
    # å¼€å‘æ¨¡å¼ä¸‹ä¹Ÿè¾“å‡ºåˆ°æ§åˆ¶å°
    [[ "${DEBUG:-false}" == "true" ]] && echo "$log_entry"
}

# æ¸…ç†å‡½æ•°
cleanup() {
    log_message "INFO" "è„šæœ¬æ‰§è¡Œå®Œæ¯•"
    rm -f "$PID_FILE"
}

trap cleanup EXIT

# ä½¿ç”¨ç¤ºä¾‹
main() {
    check_running
    log_message "INFO" "è„šæœ¬å¯åŠ¨"
    
    # ä¸šåŠ¡é€»è¾‘
    if perform_backup; then
        log_message "INFO" "å¤‡ä»½æ“ä½œæˆåŠŸå®Œæˆ"
    else
        log_message "ERROR" "å¤‡ä»½æ“ä½œå¤±è´¥"
        exit 1
    fi
}

perform_backup() {
    local backup_dir="/backup/$(date +%Y%m%d)"
    local source_dir="/important/data"
    
    log_message "INFO" "å¼€å§‹å¤‡ä»½: $source_dir -> $backup_dir"
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    if mkdir -p "$backup_dir" 2>> "$ERROR_LOG"; then
        log_message "INFO" "å¤‡ä»½ç›®å½•åˆ›å»ºæˆåŠŸ"
    else
        log_message "ERROR" "æ— æ³•åˆ›å»ºå¤‡ä»½ç›®å½•: $backup_dir"
        return 1
    fi
    
    # æ‰§è¡Œå¤‡ä»½
    if tar -czf "$backup_dir/data_backup.tar.gz" -C "$source_dir" . \
        >> "$LOG_FILE" 2>> "$ERROR_LOG"; then
        log_message "INFO" "æ•°æ®å¤‡ä»½å®Œæˆ"
        return 0
    else
        log_message "ERROR" "æ•°æ®å¤‡ä»½å¤±è´¥"
        return 1
    fi
}

main "$@"
```

### 8.3 æ—¥å¿—è½®è½¬å’Œç®¡ç†


**è‡ªåŠ¨æ—¥å¿—è½®è½¬å®ç°**ï¼š
```bash
#!/bin/bash

# æ—¥å¿—è½®è½¬ç®¡ç†è„šæœ¬
LOG_DIR="/var/log/scripts"
MAX_SIZE=10485760     # 10MB
KEEP_DAYS=30         # ä¿ç•™30å¤©
COMPRESS_DAYS=7      # 7å¤©åå‹ç¼©

rotate_logs() {
    echo "ğŸ”„ å¼€å§‹æ—¥å¿—è½®è½¬..."
    
    find "$LOG_DIR" -name "*.log" -type f | while read -r log_file; do
        local file_size=$(stat -c%s "$log_file" 2>/dev/null || echo 0)
        local base_name=$(basename "$log_file" .log)
        local dir_name=$(dirname "$log_file")
        
        # æ£€æŸ¥æ–‡ä»¶å¤§å°
        if [[ $file_size -gt $MAX_SIZE ]]; then
            local timestamp=$(date +%Y%m%d_%H%M%S)
            local rotated_file="$dir_name/${base_name}_${timestamp}.log"
            
            echo "ğŸ“‹ è½®è½¬æ—¥å¿—: $log_file -> $rotated_file"
            mv "$log_file" "$rotated_file"
            
            # åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶
            touch "$log_file"
            chmod 644 "$log_file"
            
            # é€šçŸ¥ç›¸å…³æœåŠ¡é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶
            # systemctl reload rsyslog 2>/dev/null || true
        fi
    done
    
    # å‹ç¼©æ—§æ—¥å¿—æ–‡ä»¶
    find "$LOG_DIR" -name "*.log" -type f -mtime +$COMPRESS_DAYS \
        ! -name "*.gz" -exec gzip {} \; 2>/dev/null
    
    # åˆ é™¤è¿‡æœŸæ—¥å¿—
    find "$LOG_DIR" -name "*.log*" -type f -mtime +$KEEP_DAYS \
        -delete 2>/dev/null
    
    echo "âœ… æ—¥å¿—è½®è½¬å®Œæˆ"
}

# ç£ç›˜ç©ºé—´æ£€æŸ¥
check_disk_space() {
    local usage=$(df "$LOG_DIR" | awk 'NR==2 {print $5}' | sed 's/%//')
    
    if [[ $usage -gt 80 ]]; then
        echo "âš ï¸  è­¦å‘Š: æ—¥å¿—ç›®å½•ç£ç›˜ä½¿ç”¨ç‡ ${usage}%"
        # å‘é€å‘Šè­¦é€šçŸ¥
        send_alert "LOG_DISK_FULL" "æ—¥å¿—ç›®å½•ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: ${usage}%"
    fi
}

send_alert() {
    local alert_type="$1"
    local message="$2"
    
    # è¿™é‡Œå¯ä»¥é›†æˆå„ç§å‘Šè­¦æ–¹å¼
    echo "[ALERT] $alert_type: $message" >> "/var/log/alerts.log"
    
    # ç¤ºä¾‹ï¼šå‘é€é‚®ä»¶å‘Šè­¦
    # echo "$message" | mail -s "ç³»ç»Ÿå‘Šè­¦: $alert_type" admin@example.com
    
    # ç¤ºä¾‹ï¼šè°ƒç”¨webhook
    # curl -X POST -d "text=$message" https://hooks.slack.com/webhook
}

# å®šæœŸæ‰§è¡Œ
rotate_logs
check_disk_space
```

### 8.4 æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–


**é‡å®šå‘æ€§èƒ½ç›‘æ§**ï¼š
```bash
#!/bin/bash

# æ€§èƒ½ç›‘æ§è„šæœ¬
monitor_script_performance() {
    local script_start=$(date +%s.%N)
    local memory_start=$(ps -o rss= -p $$)
    
    # ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
    execute_business_logic() {
        local operation_start=$(date +%s.%N)
        
        # æ¨¡æ‹Ÿå¤§é‡æ•°æ®å¤„ç†
        for i in {1..1000}; do
            echo "Processing item $i: $(date)" >> /tmp/large_output.log
        done
        
        local operation_end=$(date +%s.%N)
        local operation_time=$(echo "$operation_end - $operation_start" | bc)
        
        # è®°å½•æ€§èƒ½æŒ‡æ ‡
        {
            echo "PERF|$(date '+%Y-%m-%d %H:%M:%S')|OPERATION_TIME|${operation_time}s"
            echo "PERF|$(date '+%Y-%m-%d %H:%M:%S')|OUTPUT_SIZE|$(wc -c < /tmp/large_output.log) bytes"
        } >> /var/log/performance.log
    }
    
    # æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    execute_business_logic
    
    # è®¡ç®—æ€»ä½“æ€§èƒ½æŒ‡æ ‡
    local script_end=$(date +%s.%N)
    local memory_end=$(ps -o rss= -p $$)
    local total_time=$(echo "$script_end - $script_start" | bc)
    local memory_delta=$((memory_end - memory_start))
    
    # è®°å½•æ€§èƒ½æ‘˜è¦
    {
        echo "SUMMARY|$(date '+%Y-%m-%d %H:%M:%S')|TOTAL_TIME|${total_time}s"
        echo "SUMMARY|$(date '+%Y-%m-%d %H:%M:%S')|MEMORY_DELTA|${memory_delta}KB"
        echo "SUMMARY|$(date '+%Y-%m-%d %H:%M:%S')|PID|$$"
    } >> /var/log/performance.log
    
    # æ€§èƒ½å‘Šè­¦æ£€æŸ¥
    if (( $(echo "$total_time > 60" | bc -l) )); then
        send_alert "PERFORMANCE" "è„šæœ¬æ‰§è¡Œæ—¶é—´è¿‡é•¿: ${total_time}ç§’"
    fi
    
    if [[ $memory_delta -gt 100000 ]]; then  # 100MB
        send_alert "MEMORY" "å†…å­˜ä½¿ç”¨å¢é•¿è¿‡å¤§: ${memory_delta}KB"
    fi
}

# èµ„æºé™åˆ¶æ§åˆ¶
set_resource_limits() {
    # é™åˆ¶æœ€å¤§æ–‡ä»¶å¤§å° (100MB)
    ulimit -f 102400
    
    # é™åˆ¶CPUæ—¶é—´ (1å°æ—¶)
    ulimit -t 3600
    
    # é™åˆ¶å†…å­˜ä½¿ç”¨ (512MB)
    ulimit -v 524288
    
    echo "âœ… èµ„æºé™åˆ¶è®¾ç½®å®Œæˆ"
}

# æ‰§è¡Œç›‘æ§
set_resource_limits
monitor_script_performance
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è„šæœ¬é‡å®šå‘æœ¬è´¨ï¼šæ§åˆ¶Shellè„šæœ¬ä¸­æ•°æ®æµçš„æ–¹å‘
ğŸ”¸ ä¸‰å¤§æ•°æ®æµï¼šstdin(0)ã€stdout(1)ã€stderr(2)
ğŸ”¸ åŸºæœ¬é‡å®šå‘ç¬¦ï¼š> >> < 2> &> |
ğŸ”¸ é‡å®šå‘æ—¶æœºï¼šå¯ä»¥åœ¨å‘½ä»¤çº§ã€å‡½æ•°çº§ã€è„šæœ¬çº§åº”ç”¨
ğŸ”¸ æƒé™æ³¨æ„ï¼šsudoåªä½œç”¨äºå‘½ä»¤ï¼Œä¸ä½œç”¨äºé‡å®šå‘æ“ä½œ
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ—¥å¿—è®°å½•ç­–ç•¥**
```
å¼€å‘ç¯å¢ƒï¼šè¯¦ç»†è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•
æµ‹è¯•ç¯å¢ƒï¼šé€‚ä¸­è¾“å‡ºï¼Œè®°å½•å…³é”®ä¿¡æ¯
ç”Ÿäº§ç¯å¢ƒï¼šç²¾ç®€è¾“å‡ºï¼Œé‡ç‚¹è®°å½•é”™è¯¯å’Œæ€§èƒ½æŒ‡æ ‡

è®°å½•åŸåˆ™ï¼š
- æ—¶é—´æˆ³å¿…ä¸å¯å°‘
- æ—¥å¿—çº§åˆ«è¦æ˜ç¡®
- é”™è¯¯ä¿¡æ¯è¦è¯¦ç»†
- æˆåŠŸä¿¡æ¯è¦ç®€æ´
```

**ğŸ”¹ é”™è¯¯å¤„ç†æœ€ä½³å®è·µ**
```
åˆ†ç¦»å¤„ç†ï¼šæ­£å¸¸è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºåˆ†å¼€
åˆ†ç±»å¤„ç†ï¼šæ ¹æ®é”™è¯¯ç±»å‹é‡‡å–ä¸åŒç­–ç•¥
åŠæ—¶å¤„ç†ï¼šé”™è¯¯å‘ç”Ÿæ—¶ç«‹å³è®°å½•å’Œé€šçŸ¥
å…œåº•å¤„ç†ï¼šé¢„æœŸå¤–çš„é”™è¯¯ä¹Ÿè¦æœ‰å¤„ç†æœºåˆ¶
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è€ƒè™‘**
```
I/Oä¼˜åŒ–ï¼šå‡å°‘é¢‘ç¹çš„æ–‡ä»¶æ‰“å¼€å…³é—­æ“ä½œ
å†…å­˜ç®¡ç†ï¼šåŠæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶
å¹¶å‘æ§åˆ¶ï¼šåˆç†æ§åˆ¶å¹¶è¡Œä»»åŠ¡æ•°é‡
èµ„æºé™åˆ¶ï¼šè®¾ç½®åˆç†çš„èµ„æºä½¿ç”¨ä¸Šé™
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š é€‰æ‹©åˆé€‚çš„é‡å®šå‘æ–¹å¼**
- **ç®€å•è„šæœ¬**ï¼šåŸºæœ¬çš„ `>` å’Œ `>>` å°±è¶³å¤Ÿ
- **å¤æ‚ä¸šåŠ¡**ï¼šä½¿ç”¨å‡½æ•°å°è£…ï¼Œç»Ÿä¸€æ—¥å¿—æ ¼å¼
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¿…é¡»è€ƒè™‘æ—¥å¿—è½®è½¬ã€æƒé™ã€ç›‘æ§
- **è°ƒè¯•é˜¶æ®µ**ï¼šä¿ç•™è¯¦ç»†è¾“å‡ºï¼Œä¾¿äºé—®é¢˜å®šä½

**âš ï¸ å¸¸è§é™·é˜±é¿å…**
- **æƒé™é™·é˜±**ï¼šè®°ä½ `sudo echo "text" > file` ä¸ä¼šæˆåŠŸ
- **æ–‡ä»¶è¦†ç›–**ï¼šç¡®è®¤ä½¿ç”¨ `>` è¿˜æ˜¯ `>>`
- **èµ„æºæ³„æ¼**ï¼šä¸´æ—¶æ–‡ä»¶è¦åŠæ—¶æ¸…ç†
- **å¹¶å‘å†²çª**ï¼šå¤šä¸ªè¿›ç¨‹å†™åŒä¸€æ–‡ä»¶è¦åŠ é”

**ğŸ›¡ï¸ ç”Ÿäº§ç¯å¢ƒè§„èŒƒ**
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼å’Œæ–‡ä»¶å‘½å
- **ç›‘æ§æ€§**ï¼šé‡è¦æ“ä½œéƒ½è¦æœ‰æ—¥å¿—è®°å½•
- **å®‰å…¨æ€§**ï¼šæ•æ„Ÿä¿¡æ¯ä¸è¦è¾“å‡ºåˆ°æ—¥å¿—
- **ç»´æŠ¤æ€§**ï¼šè‡ªåŠ¨æ—¥å¿—è½®è½¬å’Œæ¸…ç†æœºåˆ¶

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é‡å®šå‘æ§åˆ¶æ•°æ®æµï¼Œstdin stdout stderrè¦åˆ†æ¸…
- æƒé™æå‡è¦æ³¨æ„ï¼Œsudoä½œç”¨èŒƒå›´è¦æ˜ç¡®  
- ä¸´æ—¶æ–‡ä»¶è¦æ¸…ç†ï¼Œæ€§èƒ½ç›‘æ§ä¸èƒ½å¿˜
- ç”Ÿäº§ç¯å¢ƒè¦è§„èŒƒï¼Œæ—¥å¿—è½®è½¬ä¿å®‰å…¨