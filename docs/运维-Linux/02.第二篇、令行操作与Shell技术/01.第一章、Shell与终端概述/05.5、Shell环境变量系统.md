---
title: 5、Shell环境变量系统
---
## 📚 目录

1. [环境变量基本概念](#1-环境变量基本概念)
2. [Shell变量与环境变量的区别](#2-Shell变量与环境变量的区别)
3. [变量的作用域与继承机制](#3-变量的作用域与继承机制)
4. [export命令详解](#4-export命令详解)
5. [unset命令删除变量](#5-unset命令删除变量)
6. [特殊变量详解](#6-特殊变量详解)
7. [重要系统环境变量](#7-重要系统环境变量)
8. [变量替换与参数展开](#8-变量替换与参数展开)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🌟 环境变量基本概念


### 1.1 什么是环境变量


**通俗理解**：
环境变量就像是系统的"记事本"，里面记录着各种重要信息，比如：
- 你的用户名是什么
- 程序应该从哪些地方找命令
- 当前在哪个目录
- 系统的各种配置信息

```
生活中的类比：
环境变量 = 你随身携带的身份证和地址本
- 身份证告诉别人你是谁 (用户名、家目录)
- 地址本告诉你去哪找东西 (PATH路径)
```

**💡 核心定义**
```
环境变量：存储系统和用户配置信息的键值对
格式：变量名=变量值
作用：让程序知道如何运行和在哪里找资源
```

### 1.2 环境变量的作用


**🎯 主要用途**：
- **程序查找**：告诉系统去哪找可执行程序
- **配置传递**：把设置信息传给子进程
- **路径指示**：指明重要目录的位置
- **行为控制**：影响程序的运行方式

```
实际场景：
当你输入 "ls" 命令时
1. Shell查看PATH环境变量
2. 按顺序在这些目录中寻找ls程序
3. 找到后执行程序

就像问路：你告诉别人"去超市"，他需要知道超市在哪些地方
```

---

## 2. 🔄 Shell变量与环境变量的区别


### 2.1 Shell变量（本地变量）


**📝 基本特点**：
```bash
# 创建Shell变量
name="张三"
age=25

# 只在当前Shell中有效
echo $name  # 输出：张三
```

**🏠 作用范围**：
```
Shell变量 = 只在你家里有效的规矩
- 只在当前Shell进程中存在
- 子进程看不到这些变量
- 关闭终端就消失了
```

### 2.2 环境变量


**📝 基本特点**：
```bash
# 创建并导出环境变量
export USER_NAME="李四"
export USER_AGE=30

# 在当前Shell和所有子进程中都有效
```

**🌍 作用范围**：
```
环境变量 = 全社区都认可的规则
- 在当前Shell和所有子进程中存在
- 可以被程序和脚本读取
- 影响整个会话周期
```

### 2.3 区别对比表


| 特性 | **Shell变量** | **环境变量** |
|------|-------------|-------------|
| 作用域 | 当前Shell | 当前Shell + 子进程 |
| 创建方式 | `var=value` | `export var=value` |
| 传递性 | ❌ 不传递给子进程 | ✅ 传递给子进程 |
| 查看命令 | `set` | `env` 或 `printenv` |
| 生存周期 | 当前会话 | 当前会话 + 子会话 |

**🔧 实际验证**：
```bash
# 创建Shell变量
local_var="只有我知道"

# 创建环境变量  
export global_var="大家都知道"

# 启动子Shell测试
bash
echo $local_var    # 空值，看不到
echo $global_var   # 输出：大家都知道
exit

# 回到父Shell
echo $local_var    # 输出：只有我知道
echo $global_var   # 输出：大家都知道
```

---

## 3. 📊 变量的作用域与继承机制


### 3.1 变量继承原理


**🔄 继承机制图解**：
```
父Shell进程
├── Shell变量：var1=value1 (不继承)
├── 环境变量：PATH=/usr/bin (继承) 
└── 启动子进程
    └── 子Shell进程
        ├── 继承：PATH=/usr/bin ✓
        ├── 没有：var1 ❌
        └── 可以创建自己的变量
```

**💡 通俗理解**：
```
父母和孩子的关系：
- 父母的私人物品(Shell变量) → 孩子看不到
- 家庭共同财产(环境变量) → 孩子可以使用
- 孩子长大后可以有自己的私人物品
- 但不能改变父母的财产
```

### 3.2 作用域层次


**📈 作用域层级**：
```
系统级环境变量 (所有用户)
    ↓
用户级环境变量 (当前用户所有Shell)
    ↓  
会话级环境变量 (当前Shell及子进程)
    ↓
进程级Shell变量 (仅当前Shell)
```

### 3.3 变量优先级


**⚖️ 优先级规则**：
```bash
# 如果多个地方定义了同名变量
# 优先级：本地 > 会话 > 用户 > 系统

# 演示：
export PATH="/my/path"     # 会话级，优先级最高
# 系统的PATH会被覆盖
echo $PATH  # 输出：/my/path
```

---

## 4. 🚀 export命令详解


### 4.1 export命令基本用法


**📝 基本语法**：
```bash
# 语法格式
export 变量名=值
export 变量名

# 常用方式
export PATH="/usr/local/bin:$PATH"
export EDITOR="vim"
export LANG="zh_CN.UTF-8"
```

### 4.2 export的工作方式


**🔧 工作流程**：
```
Step1: 创建/修改变量
Step2: 将变量标记为"环境变量"
Step3: 子进程启动时自动继承
```

**💡 通俗类比**：
```
export就像给变量贴上"通行证"标签：
- 没贴标签的变量(Shell变量) = 本地居民证，只能在本地用
- 贴了标签的变量(环境变量) = 国际护照，到处都能用
```

### 4.3 export的多种用法


**🎯 常用操作**：
```bash
# 1. 创建新环境变量
export NEW_VAR="hello world"

# 2. 将现有Shell变量导出为环境变量
name="张三"
export name

# 3. 修改现有环境变量
export PATH="$PATH:/my/new/path"

# 4. 临时设置环境变量
export TEMP_VAR="temporary" && some_command

# 5. 查看所有环境变量
export        # 显示所有已导出的变量
export -p     # 同上，更清晰的格式
```

**⚠️ 注意事项**：
```bash
# 错误方式
export PATH = "/usr/bin"    # ❌ 等号两边不能有空格

# 正确方式  
export PATH="/usr/bin"      # ✅ 等号紧贴变量名和值
```

---

## 5. 🗑️ unset命令删除变量


### 5.1 unset基本用法


**📝 基本语法**：
```bash
# 删除Shell变量或环境变量
unset 变量名

# 示例
name="张三"
export age=25
echo $name $age    # 输出：张三 25

unset name age
echo $name $age    # 输出：空值
```

### 5.2 unset的特点


**🔍 重要特性**：
- **彻底删除**：变量完全消失，不是设为空值
- **不区分类型**：Shell变量和环境变量都能删除
- **影响当前进程**：只影响当前Shell，不影响父进程

**💡 验证删除效果**：
```bash
# 设置变量
test_var="存在"
echo $test_var      # 输出：存在

# 删除变量
unset test_var
echo $test_var      # 输出：空（变量不存在）
echo ${test_var:-"变量已删除"}  # 输出：变量已删除
```

### 5.3 unset vs 设空值


**📊 区别对比**：
```bash
# 设置空值（变量仍存在）
var=""
echo ${var:-"默认值"}    # 输出：默认值
echo ${var+设置了}       # 输出：设置了

# 彻底删除变量
unset var
echo ${var:-"默认值"}    # 输出：默认值  
echo ${var+设置了}       # 输出：空（变量不存在）
```

---

## 6. 🔤 特殊变量详解


### 6.1 位置参数变量


**📝 基本含义**：
```bash
# $0 - 脚本名称或Shell名称
echo $0    # 输出：/bin/bash 或脚本文件名

# $1, $2, $3... - 命令行参数
# 例如运行：./script.sh hello world
# $1 = "hello", $2 = "world"
```

**🎯 实际例子**：
```bash
#!/bin/bash
# 文件名：demo.sh
echo "脚本名：$0"
echo "第1个参数：$1"  
echo "第2个参数：$2"

# 运行：./demo.sh 张三 25
# 输出：
# 脚本名：./demo.sh
# 第1个参数：张三
# 第2个参数：25
```

### 6.2 参数统计变量


**📊 参数计数**：
```bash
# $# - 参数个数（不包括$0）
echo "共有 $# 个参数"

# $* - 所有参数（作为单个字符串）
echo "所有参数：$*"

# $@ - 所有参数（作为独立参数）  
echo "参数列表：$@"
```

**🔧 $* 与 $@ 的区别**：
```bash
# 假设参数：hello world test

# $* 的行为
for arg in "$*"; do
    echo "参数：$arg"    # 输出1次：参数：hello world test
done

# $@ 的行为
for arg in "$@"; do  
    echo "参数：$arg"    # 输出3次：
done                     # 参数：hello
                        # 参数：world  
                        # 参数：test
```

### 6.3 状态相关变量


**🎯 重要状态变量**：
```bash
# $? - 上一条命令的退出状态
ls /existing/path
echo $?    # 输出：0（成功）

ls /nonexistent/path  
echo $?    # 输出：2（失败）

# $$ - 当前Shell的进程ID
echo $$    # 输出：类似 12345

# $! - 最后一个后台进程的ID
sleep 100 &
echo $!    # 输出：后台进程的PID
```

### 6.4 特殊变量速查表


| 变量 | **含义** | **示例** |
|------|---------|----------|
| `$0` | 脚本名或Shell名 | `/bin/bash` |
| `$1-$9` | 位置参数1-9 | `$1="hello"` |
| `$#` | 参数个数 | `3` |
| `$*` | 所有参数(字符串) | `"hello world"` |
| `$@` | 所有参数(数组) | `"hello" "world"` |
| `$?` | 上一命令退出状态 | `0`(成功) `非0`(失败) |
| `$$` | 当前进程ID | `12345` |
| `$!` | 最后后台进程ID | `12346` |

---

## 7. 🏠 重要系统环境变量


### 7.1 PATH变量详解


**🔍 PATH的作用**：
PATH就像是系统的"电话黄页"，当你输入一个命令时，系统会按照PATH中的目录顺序去寻找这个命令。

```bash
# 查看当前PATH
echo $PATH
# 典型输出：/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin

# PATH的工作原理
输入命令：ls
系统搜索：
1. /usr/local/bin/ls (没找到)
2. /usr/bin/ls       (找到了！执行这个)
```

**🔧 PATH管理技巧**：
```bash
# 在PATH前面添加目录（优先级最高）
export PATH="/my/bin:$PATH"

# 在PATH后面添加目录（优先级最低）  
export PATH="$PATH:/my/bin"

# 查看命令的实际位置
which ls        # 输出：/usr/bin/ls
type -a python  # 显示所有匹配的python命令
```

### 7.2 HOME和目录相关变量


**🏡 重要目录变量**：
```bash
# HOME - 用户主目录
echo $HOME     # 输出：/home/username

# PWD - 当前工作目录  
echo $PWD      # 输出：/current/working/directory

# OLDPWD - 上一个工作目录
cd /tmp
cd /home  
echo $OLDPWD   # 输出：/tmp
cd -           # 回到上一个目录 /tmp
```

**💡 实用技巧**：
```bash
# 快速回到主目录的方法
cd           # 等价于 cd $HOME
cd ~         # 等价于 cd $HOME  
cd $HOME     # 完整写法

# 在当前目录和上一目录间切换
cd -         # 等价于 cd $OLDPWD
```

### 7.3 Shell和系统配置变量


**⚙️ 常用配置变量**：
```bash
# SHELL - 当前使用的Shell
echo $SHELL    # 输出：/bin/bash

# USER/USERNAME - 当前用户名
echo $USER     # 输出：username

# LANG/LC_ALL - 语言和地区设置
echo $LANG     # 输出：zh_CN.UTF-8

# TERM - 终端类型
echo $TERM     # 输出：xterm-256color

# EDITOR - 默认编辑器
export EDITOR="vim"
```

### 7.4 系统变量快速参考


**📋 重要变量清单**：
```bash
✅ 必知变量：
PATH    - 程序搜索路径
HOME    - 用户主目录  
PWD     - 当前目录
USER    - 当前用户
SHELL   - 当前Shell

⭐ 常用变量：
EDITOR  - 默认编辑器
LANG    - 系统语言
TERM    - 终端类型
PS1     - 命令提示符格式
HISTSIZE- 历史命令数量
```

---

## 8. 🔧 变量替换与参数展开


### 8.1 基本变量替换


**📝 标准语法**：
```bash
# 基本引用
name="张三"
echo $name        # 输出：张三
echo ${name}      # 输出：张三（更安全的写法）

# 为什么要用花括号？
echo $name_age    # 查找变量 name_age（可能不存在）
echo ${name}_age  # 输出：张三_age（明确指定变量边界）
```

### 8.2 默认值处理


**🎯 默认值语法**：
```bash
# ${变量名:-默认值} - 变量为空或不存在时使用默认值
echo ${UNDEFINED_VAR:-"默认值"}    # 输出：默认值

# ${变量名:=默认值} - 变量为空或不存在时设置并使用默认值
echo ${NEW_VAR:="初始值"}          # 输出：初始值，同时设置NEW_VAR

# ${变量名:+替换值} - 变量存在且非空时使用替换值
export STATUS="active"
echo ${STATUS:+"系统运行中"}        # 输出：系统运行中
```

**💡 实际应用场景**：
```bash
# 配置文件中的默认设置
DB_HOST=${DB_HOST:-"localhost"}      # 数据库主机，默认本地
DB_PORT=${DB_PORT:-3306}            # 端口，默认3306
DEBUG_MODE=${DEBUG_MODE:-"false"}   # 调试模式，默认关闭

# 脚本参数处理
USER_NAME=${1:-"guest"}            # 第1个参数，默认guest用户
LOG_LEVEL=${2:-"info"}             # 第2个参数，默认info级别
```

### 8.3 字符串处理


**✂️ 字符串截取**：
```bash
filename="document.pdf"

# ${变量名#模式} - 从左边删除最短匹配
echo ${filename#*.}      # 输出：pdf（删除最短的*.）

# ${变量名##模式} - 从左边删除最长匹配  
filepath="/usr/local/bin/command"
echo ${filepath##*/}     # 输出：command（删除最长的*/）

# ${变量名%模式} - 从右边删除最短匹配
echo ${filename%.*}      # 输出：document（删除最短的.*）

# ${变量名%%模式} - 从右边删除最长匹配
echo ${filepath%%/*}     # 输出：空（删除最长的/*）
```

**🔍 长度和截取**：
```bash
text="Hello World"

# ${#变量名} - 获取长度
echo ${#text}            # 输出：11

# ${变量名:位置:长度} - 按位置截取
echo ${text:0:5}         # 输出：Hello（从0开始，长度5）
echo ${text:6}           # 输出：World（从位置6到末尾）
echo ${text: -5}         # 输出：World（从右边数5位）
```

### 8.4 变量替换实用技巧


**🎯 常用模式**：
```bash
# 文件路径处理
filepath="/home/user/documents/file.txt"

# 提取目录路径
dirname=${filepath%/*}        # /home/user/documents
# 提取文件名
filename=${filepath##*/}      # file.txt  
# 提取文件扩展名
extension=${filepath##*.}     # txt
# 提取不含扩展名的文件名
basename=${filename%.*}       # file

# 配置验证
CONFIG_FILE=${CONFIG_FILE:-"/etc/myapp.conf"}
if [[ -f "$CONFIG_FILE" ]]; then
    echo "使用配置文件：$CONFIG_FILE"
else
    echo "配置文件不存在：$CONFIG_FILE"
fi
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 环境变量本质：系统和程序间传递信息的机制
🔸 作用域区别：Shell变量(本地) vs 环境变量(可继承)
🔸 export作用：将Shell变量"升级"为环境变量  
🔸 特殊变量：$0-$9位置参数，$#参数个数，$?退出状态
🔸 重要变量：PATH程序路径，HOME用户目录，PWD当前目录
🔸 变量展开：${var:-default}默认值，${var#pattern}字符串处理
```

### 9.2 关键理解要点


**🔹 环境变量的继承机制**
```
记住这个关系：
父Shell ──export──> 环境变量 ──继承──> 子进程
父Shell ──本地变量──> ❌ 不继承 ──❌──> 子进程

实用场景：
- 配置信息需要传给脚本 → 用环境变量
- 临时计算结果只在当前用 → 用Shell变量
```

**🔹 PATH变量的重要性**
```
PATH = 系统找程序的"地图"
路径顺序 = 优先级高低
添加新路径的位置很关键：
- 前面添加：高优先级，可覆盖系统命令
- 后面添加：低优先级，作为备选
```

**🔹 变量替换的实用价值**
```
解决实际问题：
${var:-default}  → 配置项有默认值
${file##*/}      → 从路径提取文件名  
${file%.*}       → 去掉文件扩展名
${#string}       → 验证字符串长度
```

### 9.3 实际应用指导


**💼 常见应用场景**：
- **脚本编程**：处理命令行参数，设置默认配置
- **开发环境**：配置编译器路径，设置语言环境
- **系统管理**：自定义命令搜索路径，配置工具
- **自动化运维**：传递配置信息，处理批量任务

### 9.4 最佳实践建议


```
✅ 推荐做法：
- 用 ${var} 而不是 $var（更安全）
- 重要配置用环境变量，临时数据用Shell变量  
- 修改PATH时保留原值：export PATH="new:$PATH"
- 脚本中验证必需的环境变量是否存在

⚠️ 避免错误：
- 不要在等号两边加空格：export var=value
- 不要忘记引号：export PATH="$PATH:/new/path"  
- 不要直接覆盖重要变量：先备份再修改
```

**核心记忆口诀**：
- 环境变量能继承，Shell变量留本地
- export导出到全局，unset删除要彻底
- PATH路径有顺序，花括号引用更安全
- 特殊变量记几个，参数状态都重要