---
title: 12ã€å®šæ—¶å™¨ä¸æ—¶é—´ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [æ—¶é—´ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-æ—¶é—´ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [åŸºç¡€æ—¶é—´è·å–å‡½æ•°](#2-åŸºç¡€æ—¶é—´è·å–å‡½æ•°)
3. [å»¶æ—¶ä¸æš‚åœå‡½æ•°](#3-å»¶æ—¶ä¸æš‚åœå‡½æ•°)
4. [ä¼ ç»Ÿå®šæ—¶å™¨è®¾ç½®](#4-ä¼ ç»Ÿå®šæ—¶å™¨è®¾ç½®)
5. [POSIXé«˜çº§å®šæ—¶å™¨](#5-POSIXé«˜çº§å®šæ—¶å™¨)
6. [æ—¶é—´ç»“æ„ä½“ä¸è½¬æ¢](#6-æ—¶é—´ç»“æ„ä½“ä¸è½¬æ¢)
7. [æ—¶åŒºå¤„ç†ä¸æœ¬åœ°æ—¶é—´](#7-æ—¶åŒºå¤„ç†ä¸æœ¬åœ°æ—¶é—´)
8. [é«˜ç²¾åº¦æ—¶é’Ÿç³»ç»Ÿ](#8-é«˜ç²¾åº¦æ—¶é’Ÿç³»ç»Ÿ)
9. [å®šæ—¶å™¨ç²¾åº¦ä¸æ€§èƒ½ä¼˜åŒ–](#9-å®šæ—¶å™¨ç²¾åº¦ä¸æ€§èƒ½ä¼˜åŒ–)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. â° æ—¶é—´ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 æ—¶é—´åœ¨Linuxç³»ç»Ÿä¸­çš„è¡¨ç¤º


**æ—¶é—´çš„æœ¬è´¨ç†è§£**ï¼š
```
Unixæ—¶é—´æˆ³ï¼šä»1970å¹´1æœˆ1æ—¥00:00:00 UTCå¼€å§‹çš„ç§’æ•°
è¿™ä¸ªè®¾è®¡ç®€å•è€Œç»Ÿä¸€ï¼Œä¾¿äºè®¡ç®—å’Œå­˜å‚¨

ä¾‹å¦‚ï¼š
2024å¹´1æœˆ1æ—¥ = 1704067200ç§’ï¼ˆå¤§çº¦17äº¿ç§’ï¼‰
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå«"Unixçºªå…ƒæ—¶é—´"
```

**ğŸ”¸ æ—¶é—´ç±»å‹åˆ†ç±»**
```
ç³»ç»Ÿæ—¶é—´ç±»å‹ï¼š

1. å¢™ä¸Šæ—¶é’Ÿæ—¶é—´ï¼ˆWall Clock Timeï¼‰
   - å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸çœ‹åˆ°çš„æ—¶é—´
   - å¯èƒ½å› ä¸ºæ—¶åŒºè°ƒæ•´ã€å¤ä»¤æ—¶å˜åŒ–
   - ç”¨äºæ˜¾ç¤ºç»™ç”¨æˆ·çœ‹

2. å•è°ƒæ—¶é—´ï¼ˆMonotonic Timeï¼‰  
   - åªä¼šå•è°ƒé€’å¢ï¼Œä¸ä¼šå€’é€€
   - ä¸å—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“
   - ç”¨äºæµ‹é‡æ—¶é—´é—´éš”

3. è¿›ç¨‹æ—¶é—´ï¼ˆProcess Timeï¼‰
   - è¿›ç¨‹å®é™…å ç”¨CPUçš„æ—¶é—´
   - åˆ†ä¸ºç”¨æˆ·æ€æ—¶é—´å’Œå†…æ ¸æ€æ—¶é—´
```

### 1.2 å®šæ—¶å™¨çš„ä½œç”¨ä¸åº”ç”¨åœºæ™¯


**ğŸ’¡ å®šæ—¶å™¨è§£å†³çš„é—®é¢˜**
```
å®é™…åº”ç”¨åœºæ™¯ï¼š

ğŸ”¸ å‘¨æœŸæ€§ä»»åŠ¡
- æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ç½‘ç»œè¿æ¥
- æ¯å°æ—¶å¤‡ä»½ä¸€æ¬¡æ•°æ®
- å®šæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶

ğŸ”¸ è¶…æ—¶æ§åˆ¶
- ç½‘ç»œè¯·æ±‚è¶…æ—¶å¤„ç†
- ç”¨æˆ·è¾“å…¥è¶…æ—¶æç¤º
- æ•°æ®åº“è¿æ¥è¶…æ—¶

ğŸ”¸ æ€§èƒ½ç›‘æ§
- å®šæœŸæ”¶é›†ç³»ç»Ÿæ€§èƒ½æ•°æ®
- ç›‘æ§è¿›ç¨‹èµ„æºä½¿ç”¨
- è®°å½•ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
```

### 1.3 Linuxæ—¶é—´ç®¡ç†æ¶æ„


**ğŸ—ï¸ ç³»ç»Ÿæ—¶é—´ç®¡ç†å±‚æ¬¡**
```
åº”ç”¨å±‚ç¨‹åº
    â†“ è°ƒç”¨æ—¶é—´å‡½æ•°
æ ‡å‡†Cåº“ (glibc)
    â†“ ç³»ç»Ÿè°ƒç”¨
å†…æ ¸æ—¶é—´å­ç³»ç»Ÿ
    â†“ ç¡¬ä»¶æ¥å£
ç¡¬ä»¶æ—¶é’Ÿ (RTC, TSC)
```

---

## 2. ğŸ“… åŸºç¡€æ—¶é—´è·å–å‡½æ•°


### 2.1 time() - æœ€ç®€å•çš„æ—¶é—´è·å–


**ğŸ”¸ å‡½æ•°åŸå‹ä¸åŸºæœ¬ä½¿ç”¨**
```c
#include <time.h>
time_t time(time_t *tloc);
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
- `time()`å°±åƒé—®ç³»ç»Ÿ"ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"
- è¿”å›çš„æ˜¯ä»1970å¹´å¼€å§‹åˆ°ç°åœ¨çš„æ€»ç§’æ•°
- ç²¾åº¦åªåˆ°ç§’çº§ï¼Œé€‚åˆæ—¥å¸¸æ—¶é—´è®°å½•

**ğŸ“ åŸºç¡€ç¤ºä¾‹**
```c
#include <stdio.h>
#include <time.h>

int main() {
    time_t current_time;
    
    // è·å–å½“å‰æ—¶é—´
    current_time = time(NULL);
    
    printf("å½“å‰Unixæ—¶é—´æˆ³: %ld\n", current_time);
    printf("å¯¹åº”çš„æ—¶é—´: %s", ctime(&current_time));
    
    return 0;
}
```

**âš¡ ä¸¤ç§è·å–æ–¹å¼**
```c
// æ–¹å¼1ï¼šé€šè¿‡è¿”å›å€¼è·å–
time_t t1 = time(NULL);

// æ–¹å¼2ï¼šé€šè¿‡å‚æ•°è·å–  
time_t t2;
time(&t2);

// ä¸¤ç§æ–¹å¼ç»“æœç›¸åŒï¼Œé€‰æ‹©æ›´æ–¹ä¾¿çš„ä½¿ç”¨
```

### 2.2 gettimeofday() - å¾®ç§’çº§ç²¾åº¦æ—¶é—´


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <sys/time.h>
int gettimeofday(struct timeval *tv, struct timezone *tz);
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ›´é«˜ç²¾åº¦**ï¼š
- `time()`åªèƒ½ç²¾ç¡®åˆ°ç§’ï¼Œå¯¹äºå¾ˆå¤šåº”ç”¨ä¸å¤Ÿ
- æ€§èƒ½æµ‹è¯•éœ€è¦æ¯«ç§’ç”šè‡³å¾®ç§’ç²¾åº¦
- ç½‘ç»œç¼–ç¨‹éœ€è¦ç²¾ç¡®çš„è¶…æ—¶æ§åˆ¶

**ğŸ“Š timevalç»“æ„ä½“ç†è§£**
```c
struct timeval {
    time_t      tv_sec;     // ç§’æ•°ï¼ˆä»1970å¹´å¼€å§‹ï¼‰
    suseconds_t tv_usec;    // å¾®ç§’æ•°ï¼ˆ0-999999ï¼‰
};

// å®Œæ•´æ—¶é—´ = tv_sec + tv_usec/1000000
```

**ğŸ“ å®é™…ä½¿ç”¨ç¤ºä¾‹**
```c
#include <stdio.h>
#include <sys/time.h>

int main() {
    struct timeval tv;
    
    // è·å–é«˜ç²¾åº¦æ—¶é—´
    gettimeofday(&tv, NULL);
    
    printf("ç§’æ•°: %ld\n", tv.tv_sec);
    printf("å¾®ç§’æ•°: %ld\n", tv.tv_usec);
    
    // è®¡ç®—ç²¾ç¡®çš„æ—¶é—´æˆ³ï¼ˆåŒ…å«å°æ•°éƒ¨åˆ†ï¼‰
    double precise_time = tv.tv_sec + tv.tv_usec / 1000000.0;
    printf("ç²¾ç¡®æ—¶é—´æˆ³: %.6f\n", precise_time);
    
    return 0;
}
```

### 2.3 æ—¶é—´è·å–å‡½æ•°å¯¹æ¯”


| å‡½æ•° | **ç²¾åº¦** | **ç”¨é€”** | **ä¼˜ç¼ºç‚¹** |
|------|---------|---------|-----------|
| ğŸ“… **time()** | `ç§’çº§` | `æ—¥å¸¸æ—¶é—´è®°å½•` | `ç®€å•æ˜“ç”¨ï¼Œç²¾åº¦æœ‰é™` |
| â±ï¸ **gettimeofday()** | `å¾®ç§’çº§` | `æ€§èƒ½æµ‹è¯•ï¼Œç½‘ç»œç¼–ç¨‹` | `ç²¾åº¦é«˜ï¼Œæ¥å£ç¨å¤æ‚` |
| ğŸ¯ **clock_gettime()** | `çº³ç§’çº§` | `é«˜ç²¾åº¦è®¡æ—¶` | `æœ€é«˜ç²¾åº¦ï¼Œéœ€è¦é“¾æ¥-lrt` |

---

## 3. ğŸ’¤ å»¶æ—¶ä¸æš‚åœå‡½æ•°


### 3.1 sleep() - ç§’çº§æš‚åœ


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <unistd.h>
unsigned int sleep(unsigned int seconds);
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
- `sleep()`å°±æ˜¯è®©ç¨‹åº"ç¡è§‰"æŒ‡å®šçš„ç§’æ•°
- åœ¨æ­¤æœŸé—´ï¼Œç¨‹åºä¸æ¶ˆè€—CPUèµ„æº
- å°±åƒäººç¡è§‰ä¸€æ ·ï¼Œæš‚åœæ‰€æœ‰æ´»åŠ¨

**ğŸ“ åŸºç¡€ä½¿ç”¨**
```c
#include <stdio.h>
#include <unistd.h>

int main() {
    printf("å¼€å§‹æ‰§è¡Œ...\n");
    
    printf("æš‚åœ3ç§’...\n");
    sleep(3);  // ç¨‹åºæš‚åœ3ç§’
    
    printf("ç»§ç»­æ‰§è¡Œ!\n");
    return 0;
}
```

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
```c
// sleepå¯èƒ½è¢«ä¿¡å·ä¸­æ–­
unsigned int remaining = sleep(10);
if (remaining > 0) {
    printf("sleepè¢«ä¸­æ–­ï¼Œè¿˜å‰©%uç§’æœªç¡å¤Ÿ\n", remaining);
}
```

### 3.2 usleep() - å¾®ç§’çº§æš‚åœ


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <unistd.h>
int usleep(useconds_t usec);
```

**ğŸ’¡ æ›´ç²¾ç»†çš„æ§åˆ¶**ï¼š
- å½“éœ€è¦æ¯«ç§’çº§çš„æš‚åœæ—¶ï¼Œ`sleep()`å°±ä¸å¤Ÿç”¨äº†
- `usleep()`å¯ä»¥æš‚åœå¾®ç§’çº§çš„æ—¶é—´
- 1ç§’ = 1,000,000å¾®ç§’

**ğŸ“ å®é™…åº”ç”¨ç¤ºä¾‹**
```c
#include <stdio.h>
#include <unistd.h>

int main() {
    int i;
    
    printf("æ¯éš”0.5ç§’æ‰“å°ä¸€ä¸ªæ•°å­—:\n");
    for (i = 1; i <= 5; i++) {
        printf("%d ", i);
        fflush(stdout);  // å¼ºåˆ¶è¾“å‡ºç¼“å†²
        usleep(500000);  // æš‚åœ0.5ç§’ (500,000å¾®ç§’)
    }
    printf("\nå®Œæˆ!\n");
    
    return 0;
}
```

### 3.3 nanosleep() - çº³ç§’çº§é«˜ç²¾åº¦æš‚åœ


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <time.h>
int nanosleep(const struct timespec *req, struct timespec *rem);
```

**ğŸ’¡ æœ€é«˜ç²¾åº¦çš„æš‚åœ**ï¼š
- ç²¾åº¦è¾¾åˆ°çº³ç§’çº§ï¼ˆ1ç§’=10äº¿çº³ç§’ï¼‰
- èƒ½æ›´å¥½åœ°å¤„ç†ä¿¡å·ä¸­æ–­
- æ˜¯ç›®å‰æ¨èçš„æš‚åœå‡½æ•°

**ğŸ“Š timespecç»“æ„ä½“**
```c
struct timespec {
    time_t tv_sec;   // ç§’æ•°
    long   tv_nsec;  // çº³ç§’æ•°ï¼ˆ0-999,999,999ï¼‰
};
```

**ğŸ“ é«˜ç²¾åº¦æš‚åœç¤ºä¾‹**
```c
#include <stdio.h>
#include <time.h>

int main() {
    struct timespec req, rem;
    
    // è®¾ç½®æš‚åœæ—¶é—´ï¼š1.5ç§’
    req.tv_sec = 1;           // 1ç§’
    req.tv_nsec = 500000000;  // 0.5ç§’ = 500,000,000çº³ç§’
    
    printf("å¼€å§‹é«˜ç²¾åº¦æš‚åœ1.5ç§’...\n");
    
    // æš‚åœï¼Œå¦‚æœè¢«ä¿¡å·ä¸­æ–­ä¼šè¿”å›å‰©ä½™æ—¶é—´
    if (nanosleep(&req, &rem) == -1) {
        printf("æš‚åœè¢«ä¸­æ–­ï¼Œå‰©ä½™: %ld.%09ldç§’\n", 
               rem.tv_sec, rem.tv_nsec);
    }
    
    printf("æš‚åœç»“æŸ!\n");
    return 0;
}
```

### 3.4 å»¶æ—¶å‡½æ•°é€‰æ‹©æŒ‡å—


**ğŸ¯ é€‰æ‹©åŸåˆ™**
```
ç§’çº§å»¶æ—¶ï¼š
âœ… ä½¿ç”¨ sleep()
- ç®€å•çš„æ•´æ•°ç§’æš‚åœ
- ä¸éœ€è¦é«˜ç²¾åº¦çš„åœºåˆ

æ¯«ç§’çº§å»¶æ—¶ï¼š
âœ… ä½¿ç”¨ usleep() æˆ– nanosleep()
- usleep(1000) = 1æ¯«ç§’
- æ¨ènanosleep()ï¼Œæ›´æ ‡å‡†

å¾®ç§’/çº³ç§’çº§å»¶æ—¶ï¼š
âœ… ä½¿ç”¨ nanosleep()
- æœ€é«˜ç²¾åº¦æ§åˆ¶
- æ›´å¥½çš„ä¿¡å·å¤„ç†
```

---

## 4. â° ä¼ ç»Ÿå®šæ—¶å™¨è®¾ç½®


### 4.1 alarm() - ç®€å•çš„ç§’çº§å®šæ—¶å™¨


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <unistd.h>
unsigned int alarm(unsigned int seconds);
```

**ğŸ’¡ å®šæ—¶å™¨çš„å·¥ä½œåŸç†**ï¼š
- `alarm()`å°±åƒè®¾ç½®ä¸€ä¸ªé—¹é’Ÿ
- åˆ°æ—¶é—´åç³»ç»Ÿä¼šå‘é€SIGALRMä¿¡å·ç»™è¿›ç¨‹
- è¿›ç¨‹éœ€è¦æå‰è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°æ¥å“åº”

**ğŸ“ åŸºç¡€å®šæ—¶å™¨ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

// ä¿¡å·å¤„ç†å‡½æ•°
void alarm_handler(int sig) {
    printf("å®šæ—¶å™¨åˆ°æ—¶äº†! æ”¶åˆ°ä¿¡å·: %d\n", sig);
}

int main() {
    // æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°
    signal(SIGALRM, alarm_handler);
    
    printf("è®¾ç½®5ç§’å®šæ—¶å™¨...\n");
    alarm(5);  // 5ç§’åå‘é€SIGALRMä¿¡å·
    
    printf("ç­‰å¾…å®šæ—¶å™¨åˆ°æ—¶...\n");
    pause();   // æš‚åœç¨‹åºï¼Œç­‰å¾…ä¿¡å·
    
    printf("ç¨‹åºç»§ç»­æ‰§è¡Œ\n");
    return 0;
}
```

**âš ï¸ alarm()çš„é‡è¦é™åˆ¶**
```c
// æ¯ä¸ªè¿›ç¨‹åªèƒ½æœ‰ä¸€ä¸ªalarmå®šæ—¶å™¨
alarm(10);  // è®¾ç½®10ç§’å®šæ—¶å™¨
alarm(5);   // æ–°çš„5ç§’å®šæ—¶å™¨ä¼šå–æ¶ˆå‰é¢çš„10ç§’å®šæ—¶å™¨

// å–æ¶ˆå®šæ—¶å™¨
alarm(0);   // ä¼ å…¥0å–æ¶ˆå½“å‰å®šæ—¶å™¨
```

### 4.2 setitimer() - é«˜ç²¾åº¦é—´éš”å®šæ—¶å™¨


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <sys/time.h>
int setitimer(int which, const struct itimerval *new_value,
              struct itimerval *old_value);
```

**ğŸ’¡ setitimerçš„ä¼˜åŠ¿**ï¼š
- ç²¾åº¦å¯è¾¾å¾®ç§’çº§
- æ”¯æŒå‘¨æœŸæ€§å®šæ—¶å™¨ï¼ˆè‡ªåŠ¨é‡å¤ï¼‰
- æä¾›ä¸‰ç§ä¸åŒç±»å‹çš„å®šæ—¶å™¨

**ğŸ“Š ä¸‰ç§å®šæ—¶å™¨ç±»å‹**
```
ITIMER_REALï¼š
- çœŸå®æ—¶é—´å®šæ—¶å™¨ï¼ˆå¢™ä¸Šæ—¶é’Ÿæ—¶é—´ï¼‰
- åˆ°æ—¶å‘é€SIGALRMä¿¡å·
- ç›¸å½“äºç§’è¡¨è®¡æ—¶

ITIMER_VIRTUALï¼š
- è¿›ç¨‹ç”¨æˆ·æ€CPUæ—¶é—´
- åˆ°æ—¶å‘é€SIGVTALRMä¿¡å·
- åªè®¡ç®—è¿›ç¨‹å®é™…è¿è¡Œæ—¶é—´

ITIMER_PROFï¼š
- è¿›ç¨‹æ€»CPUæ—¶é—´ï¼ˆç”¨æˆ·æ€+å†…æ ¸æ€ï¼‰
- åˆ°æ—¶å‘é€SIGPROFä¿¡å·
- ç”¨äºæ€§èƒ½åˆ†æ
```

**ğŸ“Š itimervalç»“æ„ä½“**
```c
struct itimerval {
    struct timeval it_interval;  // é—´éš”æ—¶é—´ï¼ˆå‘¨æœŸæ€§å®šæ—¶å™¨ï¼‰
    struct timeval it_value;     // åˆå§‹å»¶æ—¶æ—¶é—´
};

struct timeval {
    time_t      tv_sec;   // ç§’
    suseconds_t tv_usec;  // å¾®ç§’
};
```

**ğŸ“ å‘¨æœŸæ€§å®šæ—¶å™¨ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <sys/time.h>
#include <unistd.h>

int timer_count = 0;

// å®šæ—¶å™¨ä¿¡å·å¤„ç†å‡½æ•°
void timer_handler(int sig) {
    timer_count++;
    printf("å®šæ—¶å™¨è§¦å‘ç¬¬%dæ¬¡\n", timer_count);
    
    if (timer_count >= 5) {
        printf("å®šæ—¶å™¨å®Œæˆ5æ¬¡ï¼Œç¨‹åºé€€å‡º\n");
        exit(0);
    }
}

int main() {
    struct itimerval timer;
    
    // æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°
    signal(SIGALRM, timer_handler);
    
    // è®¾ç½®å®šæ—¶å™¨å‚æ•°
    timer.it_value.tv_sec = 2;      // 2ç§’åç¬¬ä¸€æ¬¡è§¦å‘
    timer.it_value.tv_usec = 0;
    timer.it_interval.tv_sec = 1;   // ä¹‹åæ¯1ç§’è§¦å‘ä¸€æ¬¡
    timer.it_interval.tv_usec = 0;
    
    // å¯åŠ¨å®šæ—¶å™¨
    setitimer(ITIMER_REAL, &timer, NULL);
    
    printf("å‘¨æœŸæ€§å®šæ—¶å™¨å¯åŠ¨ï¼Œæ¯1ç§’è§¦å‘ä¸€æ¬¡\n");
    
    // ç­‰å¾…å®šæ—¶å™¨äº‹ä»¶
    while (1) {
        pause();
    }
    
    return 0;
}
```

### 4.3 ä¼ ç»Ÿå®šæ—¶å™¨çš„ä½¿ç”¨åœºæ™¯


**âœ… é€‚ç”¨åœºæ™¯**
```
ç®€å•çš„è¶…æ—¶æ§åˆ¶ï¼š
- ç½‘ç»œè¿æ¥è¶…æ—¶
- ç”¨æˆ·è¾“å…¥è¶…æ—¶
- ç®€å•çš„å‘¨æœŸæ€§ä»»åŠ¡

æ€§èƒ½ç›‘æ§ï¼š
- å®šæœŸæ”¶é›†ç³»ç»Ÿä¿¡æ¯
- å‘¨æœŸæ€§æ—¥å¿—è®°å½•
```

**âŒ å±€é™æ€§**
```
å•ä¸€å®šæ—¶å™¨é™åˆ¶ï¼š
- alarm()æ¯ä¸ªè¿›ç¨‹åªèƒ½æœ‰ä¸€ä¸ª
- setitimer()æ¯ç§ç±»å‹åªèƒ½æœ‰ä¸€ä¸ª

ä¿¡å·å¤„ç†å¤æ‚ï¼š
- ä¿¡å·å¤„ç†å‡½æ•°æœ‰å¾ˆå¤šé™åˆ¶
- ä¿¡å·å¯èƒ½ä¸¢å¤±æˆ–è¢«é˜»å¡
```

---

## 5. ğŸ¯ POSIXé«˜çº§å®šæ—¶å™¨


### 5.1 timer_create() - åˆ›å»ºé«˜çº§å®šæ—¶å™¨


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <signal.h>
#include <time.h>
int timer_create(clockid_t clockid, struct sigevent *sevp, timer_t *timerid);
```

**ğŸ’¡ POSIXå®šæ—¶å™¨çš„ä¼˜åŠ¿**ï¼š
- å¯ä»¥åˆ›å»ºå¤šä¸ªç‹¬ç«‹å®šæ—¶å™¨
- æ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼ï¼ˆä¿¡å·ã€çº¿ç¨‹ã€æ— é€šçŸ¥ï¼‰
- æ›´ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶
- æ›´çµæ´»çš„é…ç½®é€‰é¡¹

**ğŸ“Š æ—¶é’Ÿç±»å‹é€‰æ‹©**
```
CLOCK_REALTIMEï¼š
- ç³»ç»Ÿå®æ—¶æ—¶é’Ÿ
- ä¼šå—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“
- é€‚åˆç»å¯¹æ—¶é—´å®šæ—¶

CLOCK_MONOTONICï¼š
- å•è°ƒé€’å¢æ—¶é’Ÿ
- ä¸å—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“
- é€‚åˆé—´éš”å®šæ—¶
```

**ğŸ“ åˆ›å»ºåŸºç¡€å®šæ—¶å™¨**
```c
#include <stdio.h>
#include <signal.h>
#include <time.h>
#include <unistd.h>

void timer_handler(int sig, siginfo_t *si, void *uc) {
    timer_t *tidp = si->si_value.sival_ptr;
    printf("å®šæ—¶å™¨è§¦å‘ï¼ŒID: %p\n", tidp);
}

int main() {
    timer_t timerid;
    struct sigevent sev;
    struct sigaction sa;
    
    // è®¾ç½®ä¿¡å·å¤„ç†
    sa.sa_flags = SA_SIGINFO;
    sa.sa_sigaction = timer_handler;
    sigemptyset(&sa.sa_mask);
    sigaction(SIGRTMIN, &sa, NULL);
    
    // é…ç½®å®šæ—¶å™¨é€šçŸ¥æ–¹å¼
    sev.sigev_notify = SIGEV_SIGNAL;    // é€šè¿‡ä¿¡å·é€šçŸ¥
    sev.sigev_signo = SIGRTMIN;         // ä½¿ç”¨å®æ—¶ä¿¡å·
    sev.sigev_value.sival_ptr = &timerid;
    
    // åˆ›å»ºå®šæ—¶å™¨
    if (timer_create(CLOCK_REALTIME, &sev, &timerid) == -1) {
        perror("timer_create");
        return 1;
    }
    
    printf("POSIXå®šæ—¶å™¨åˆ›å»ºæˆåŠŸ\n");
    return 0;
}
```

### 5.2 timer_settime() - è®¾ç½®å®šæ—¶å™¨æ—¶é—´


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <time.h>
int timer_settime(timer_t timerid, int flags,
                  const struct itimerspec *new_value,
                  struct itimerspec *old_value);
```

**ğŸ“Š itimerspecç»“æ„ä½“**
```c
struct itimerspec {
    struct timespec it_interval;  // é—´éš”æ—¶é—´ï¼ˆå‘¨æœŸæ€§ï¼‰
    struct timespec it_value;     // åˆå§‹å»¶æ—¶
};

struct timespec {
    time_t tv_sec;   // ç§’
    long   tv_nsec;  // çº³ç§’
};
```

**ğŸ“ å®Œæ•´çš„POSIXå®šæ—¶å™¨ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <time.h>
#include <unistd.h>
#include <stdlib.h>

int timer_count = 0;

void timer_handler(int sig, siginfo_t *si, void *uc) {
    timer_count++;
    printf("é«˜çº§å®šæ—¶å™¨è§¦å‘ç¬¬%dæ¬¡\n", timer_count);
    
    if (timer_count >= 3) {
        printf("å®šæ—¶å™¨å®Œæˆï¼Œç¨‹åºé€€å‡º\n");
        exit(0);
    }
}

int main() {
    timer_t timerid;
    struct sigevent sev;
    struct itimerspec its;
    struct sigaction sa;
    
    // è®¾ç½®ä¿¡å·å¤„ç†
    sa.sa_flags = SA_SIGINFO;
    sa.sa_sigaction = timer_handler;
    sigemptyset(&sa.sa_mask);
    sigaction(SIGRTMIN, &sa, NULL);
    
    // é…ç½®å®šæ—¶å™¨é€šçŸ¥
    sev.sigev_notify = SIGEV_SIGNAL;
    sev.sigev_signo = SIGRTMIN;
    sev.sigev_value.sival_ptr = &timerid;
    
    // åˆ›å»ºå®šæ—¶å™¨
    timer_create(CLOCK_REALTIME, &sev, &timerid);
    
    // è®¾ç½®å®šæ—¶å™¨æ—¶é—´
    its.it_value.tv_sec = 1;          // 1ç§’åé¦–æ¬¡è§¦å‘
    its.it_value.tv_nsec = 500000000; // åŠ 0.5ç§’
    its.it_interval.tv_sec = 2;       // ä¹‹åæ¯2ç§’è§¦å‘
    its.it_interval.tv_nsec = 0;
    
    // å¯åŠ¨å®šæ—¶å™¨
    timer_settime(timerid, 0, &its, NULL);
    
    printf("é«˜çº§å®šæ—¶å™¨å¯åŠ¨ï¼š1.5ç§’åé¦–æ¬¡è§¦å‘ï¼Œç„¶åæ¯2ç§’è§¦å‘\n");
    
    // ç­‰å¾…å®šæ—¶å™¨äº‹ä»¶
    while (1) {
        pause();
    }
    
    return 0;
}
```

### 5.3 å®šæ—¶å™¨ç®¡ç†å‡½æ•°


**ğŸ“ è·å–å®šæ—¶å™¨çŠ¶æ€**
```c
// æŸ¥çœ‹å®šæ—¶å™¨å‰©ä½™æ—¶é—´
struct itimerspec curr_value;
timer_gettime(timerid, &curr_value);

printf("å‰©ä½™æ—¶é—´: %ld.%09ldç§’\n", 
       curr_value.it_value.tv_sec,
       curr_value.it_value.tv_nsec);
```

**ğŸ“ åˆ é™¤å®šæ—¶å™¨**
```c
// åœæ­¢å¹¶åˆ é™¤å®šæ—¶å™¨
timer_delete(timerid);
printf("å®šæ—¶å™¨å·²åˆ é™¤\n");
```

---

## 6. ğŸ“Š æ—¶é—´ç»“æ„ä½“ä¸è½¬æ¢


### 6.1 ä¸»è¦æ—¶é—´ç»“æ„ä½“å¯¹æ¯”


**ğŸ“‹ ç»“æ„ä½“ç±»å‹æ€»è§ˆ**
```
time_tï¼š
- ç®€å•çš„æ•´æ•°ç±»å‹
- è¡¨ç¤ºä»1970å¹´å¼€å§‹çš„ç§’æ•°
- æœ€åŸºç¡€çš„æ—¶é—´è¡¨ç¤º

struct tmï¼š
- åˆ†è§£æ—¶é—´ç»“æ„
- åŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’ç­‰å­—æ®µ
- ä¾¿äºäººç±»ç†è§£çš„æ—¶é—´æ ¼å¼

struct timevalï¼š
- å¾®ç§’ç²¾åº¦æ—¶é—´
- åŒ…å«ç§’å’Œå¾®ç§’ä¸¤ä¸ªå­—æ®µ

struct timespecï¼š
- çº³ç§’ç²¾åº¦æ—¶é—´  
- åŒ…å«ç§’å’Œçº³ç§’ä¸¤ä¸ªå­—æ®µ
```

### 6.2 struct tmè¯¦è§£


**ğŸ“Š tmç»“æ„ä½“æˆå‘˜**
```c
struct tm {
    int tm_sec;    // ç§’ (0-60ï¼Œ60æ˜¯é—°ç§’)
    int tm_min;    // åˆ† (0-59)
    int tm_hour;   // æ—¶ (0-23)
    int tm_mday;   // æ—¥ (1-31)
    int tm_mon;    // æœˆ (0-11ï¼Œæ³¨æ„0è¡¨ç¤º1æœˆ!)
    int tm_year;   // å¹´ (ä»1900å¹´å¼€å§‹çš„å¹´æ•°)
    int tm_wday;   // æ˜ŸæœŸ (0-6ï¼Œ0è¡¨ç¤ºæ˜ŸæœŸæ—¥)
    int tm_yday;   // ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤© (0-365)
    int tm_isdst;  // å¤ä»¤æ—¶æ ‡å¿—
};
```

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
```c
// å¸¸è§é™·é˜±å’Œæ­£ç¡®ç”¨æ³•
struct tm timeinfo;

// é”™è¯¯ï¼šç›´æ¥èµ‹å€¼å¹´ä»½
timeinfo.tm_year = 2024;  // âŒ é”™è¯¯ï¼

// æ­£ç¡®ï¼šå¹´ä»½éœ€è¦å‡å»1900
timeinfo.tm_year = 2024 - 1900;  // âœ… æ­£ç¡®

// é”™è¯¯ï¼šç›´æ¥èµ‹å€¼æœˆä»½
timeinfo.tm_mon = 3;  // âŒ é”™è¯¯ï¼è¿™è¡¨ç¤º4æœˆ

// æ­£ç¡®ï¼šæœˆä»½ä»0å¼€å§‹
timeinfo.tm_mon = 2;  // âœ… æ­£ç¡®ï¼Œè¿™æ‰æ˜¯3æœˆ
```

### 6.3 æ—¶é—´è½¬æ¢å‡½æ•°


**ğŸ”„ time_tä¸struct tmäº’è½¬**
```c
#include <stdio.h>
#include <time.h>

int main() {
    time_t raw_time;
    struct tm *timeinfo;
    
    // è·å–å½“å‰æ—¶é—´
    time(&raw_time);
    printf("Unixæ—¶é—´æˆ³: %ld\n", raw_time);
    
    // è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ç»“æ„
    timeinfo = localtime(&raw_time);
    printf("æœ¬åœ°æ—¶é—´: %då¹´%dæœˆ%dæ—¥ %d:%d:%d\n",
           timeinfo->tm_year + 1900,  // å¹´ä»½è¦åŠ 1900
           timeinfo->tm_mon + 1,      // æœˆä»½è¦åŠ 1
           timeinfo->tm_mday,
           timeinfo->tm_hour,
           timeinfo->tm_min,
           timeinfo->tm_sec);
    
    // è½¬æ¢ä¸ºUTCæ—¶é—´ç»“æ„
    timeinfo = gmtime(&raw_time);
    printf("UTCæ—¶é—´: %då¹´%dæœˆ%dæ—¥ %d:%d:%d\n",
           timeinfo->tm_year + 1900,
           timeinfo->tm_mon + 1,
           timeinfo->tm_mday,
           timeinfo->tm_hour,
           timeinfo->tm_min,
           timeinfo->tm_sec);
    
    // å°†æ—¶é—´ç»“æ„è½¬å›time_t
    time_t converted = mktime(timeinfo);
    printf("è½¬æ¢å›çš„æ—¶é—´æˆ³: %ld\n", converted);
    
    return 0;
}
```

**ğŸ“ æ—¶é—´æ ¼å¼åŒ–è¾“å‡º**
```c
#include <stdio.h>
#include <time.h>

int main() {
    time_t raw_time;
    struct tm *timeinfo;
    char buffer[100];
    
    time(&raw_time);
    timeinfo = localtime(&raw_time);
    
    // ä½¿ç”¨strftimeæ ¼å¼åŒ–æ—¶é—´
    strftime(buffer, sizeof(buffer), "%Y-%m-%d %H:%M:%S", timeinfo);
    printf("æ ¼å¼åŒ–æ—¶é—´: %s\n", buffer);
    
    strftime(buffer, sizeof(buffer), "%A, %B %d, %Y", timeinfo);
    printf("è¯¦ç»†æ ¼å¼: %s\n", buffer);
    
    strftime(buffer, sizeof(buffer), "%Yå¹´%mæœˆ%dæ—¥ æ˜ŸæœŸ%w", timeinfo);
    printf("ä¸­æ–‡æ ¼å¼: %s\n", buffer);
    
    return 0;
}
```

### 6.4 å¸¸ç”¨è½¬æ¢å‡½æ•°æ€»ç»“


| å‡½æ•° | **åŠŸèƒ½** | **ç”¨é€”** |
|------|---------|---------|
| ğŸ”„ **localtime()** | `time_t â†’ struct tm (æœ¬åœ°æ—¶é—´)` | `æ˜¾ç¤ºæœ¬åœ°æ—¶é—´` |
| ğŸŒ **gmtime()** | `time_t â†’ struct tm (UTCæ—¶é—´)` | `æ˜¾ç¤ºUTCæ—¶é—´` |
| â° **mktime()** | `struct tm â†’ time_t` | `æ—¶é—´ç»“æ„è½¬æ—¶é—´æˆ³` |
| ğŸ“ **strftime()** | `struct tm â†’ æ ¼å¼åŒ–å­—ç¬¦ä¸²` | `è‡ªå®šä¹‰æ—¶é—´æ ¼å¼` |
| ğŸ“„ **ctime()** | `time_t â†’ æ ‡å‡†æ ¼å¼å­—ç¬¦ä¸²` | `å¿«é€Ÿæ—¶é—´æ˜¾ç¤º` |

---

## 7. ğŸŒ æ—¶åŒºå¤„ç†ä¸æœ¬åœ°æ—¶é—´


### 7.1 æ—¶åŒºæ¦‚å¿µç†è§£


**ğŸ’¡ æ—¶åŒºçš„æœ¬è´¨**ï¼š
- åœ°çƒåˆ†ä¸º24ä¸ªæ—¶åŒºï¼Œæ¯ä¸ªæ—¶åŒºç›¸å·®1å°æ—¶
- UTCï¼ˆåè°ƒä¸–ç•Œæ—¶ï¼‰æ˜¯æ—¶åŒºçš„åŸºå‡†
- æœ¬åœ°æ—¶é—´ = UTCæ—¶é—´ + æ—¶åŒºåç§»

**ğŸ—ºï¸ æ—¶åŒºè¡¨ç¤ºæ–¹æ³•**
```
å¸¸è§æ—¶åŒºè¡¨ç¤ºï¼š

UTC+8ï¼šåŒ—äº¬æ—¶é—´
UTC+0ï¼šä¼¦æ•¦æ—¶é—´ï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼‰
UTC-5ï¼šçº½çº¦æ—¶é—´ï¼ˆä¸œéƒ¨æ ‡å‡†æ—¶é—´ï¼‰
UTC-8ï¼šæ´›æ‰çŸ¶æ—¶é—´ï¼ˆå¤ªå¹³æ´‹æ ‡å‡†æ—¶é—´ï¼‰
```

### 7.2 Linuxæ—¶åŒºé…ç½®


**ğŸ“ ç³»ç»Ÿæ—¶åŒºè®¾ç½®**
```bash
# æŸ¥çœ‹å½“å‰æ—¶åŒº
date
timedatectl status

# è®¾ç½®æ—¶åŒºï¼ˆéœ€è¦rootæƒé™ï¼‰
timedatectl set-timezone Asia/Shanghai

# æŸ¥çœ‹å¯ç”¨æ—¶åŒº
timedatectl list-timezones | grep Asia
```

**ğŸ“ ç¨‹åºä¸­çš„æ—¶åŒºå¤„ç†**
```c
#include <stdio.h>
#include <time.h>
#include <stdlib.h>

int main() {
    time_t raw_time;
    struct tm *timeinfo;
    
    time(&raw_time);
    
    // æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¶åŒºçš„æ—¶é—´
    timeinfo = localtime(&raw_time);
    printf("ç³»ç»Ÿæœ¬åœ°æ—¶é—´: %s", asctime(timeinfo));
    
    // æ˜¾ç¤ºUTCæ—¶é—´
    timeinfo = gmtime(&raw_time);
    printf("UTCæ—¶é—´: %s", asctime(timeinfo));
    
    // ä¸´æ—¶æ”¹å˜æ—¶åŒºç¯å¢ƒå˜é‡
    setenv("TZ", "America/New_York", 1);
    tzset();  // é‡æ–°åŠ è½½æ—¶åŒºä¿¡æ¯
    
    timeinfo = localtime(&raw_time);
    printf("çº½çº¦æ—¶é—´: %s", asctime(timeinfo));
    
    // æ¢å¤åŸæ—¶åŒº
    unsetenv("TZ");
    tzset();
    
    return 0;
}
```

### 7.3 å¤ä»¤æ—¶å¤„ç†


**ğŸ’¡ å¤ä»¤æ—¶çš„å½±å“**ï¼š
- æŸäº›åœ°åŒºåœ¨å¤å­£ä¼šå°†æ—¶é’Ÿè°ƒå¿«1å°æ—¶
- ç¨‹åºéœ€è¦æ­£ç¡®å¤„ç†å¤ä»¤æ—¶è½¬æ¢
- `tm_isdst`å­—æ®µæŒ‡ç¤ºæ˜¯å¦ä¸ºå¤ä»¤æ—¶

**ğŸ“ å¤ä»¤æ—¶æ£€æµ‹ç¤ºä¾‹**
```c
#include <stdio.h>
#include <time.h>

void print_dst_info(struct tm *timeinfo) {
    if (timeinfo->tm_isdst > 0) {
        printf("å½“å‰æ˜¯å¤ä»¤æ—¶\n");
    } else if (timeinfo->tm_isdst == 0) {
        printf("å½“å‰ä¸æ˜¯å¤ä»¤æ—¶\n");
    } else {
        printf("å¤ä»¤æ—¶ä¿¡æ¯ä¸å¯ç”¨\n");
    }
}

int main() {
    time_t raw_time;
    struct tm *timeinfo;
    
    time(&raw_time);
    timeinfo = localtime(&raw_time);
    
    printf("å½“å‰æ—¶é—´: %s", asctime(timeinfo));
    print_dst_info(timeinfo);
    
    return 0;
}
```

---

## 8. ğŸ¯ é«˜ç²¾åº¦æ—¶é’Ÿç³»ç»Ÿ


### 8.1 clock_gettime() - çº³ç§’çº§æ—¶é—´è·å–


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <time.h>
int clock_gettime(clockid_t clk_id, struct timespec *tp);
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦é«˜ç²¾åº¦æ—¶é’Ÿ**ï¼š
- ç°ä»£åº”ç”¨å¯¹æ—¶é—´ç²¾åº¦è¦æ±‚è¶Šæ¥è¶Šé«˜
- æ€§èƒ½æµ‹è¯•éœ€è¦çº³ç§’çº§ç²¾åº¦
- ç§‘å­¦è®¡ç®—éœ€è¦æé«˜çš„æ—¶é—´ç²¾åº¦
- å®æ—¶ç³»ç»Ÿéœ€è¦ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶

**ğŸ“Š æ—¶é’Ÿç±»å‹è¯¦è§£**
```
CLOCK_REALTIMEï¼š
- ç³»ç»Ÿå®æ—¶æ—¶é’Ÿ
- å¯èƒ½è¢«ç³»ç»Ÿç®¡ç†å‘˜è°ƒæ•´
- é€‚åˆæ˜¾ç¤ºæ—¶é—´

CLOCK_MONOTONICï¼š
- å•è°ƒé€’å¢æ—¶é’Ÿ
- ä¸å—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“  
- é€‚åˆè®¡ç®—æ—¶é—´é—´éš”

CLOCK_PROCESS_CPUTIME_IDï¼š
- è¿›ç¨‹CPUæ—¶é—´
- åªè®¡ç®—æœ¬è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´

CLOCK_THREAD_CPUTIME_IDï¼š
- çº¿ç¨‹CPUæ—¶é—´
- åªè®¡ç®—å½“å‰çº¿ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´
```

**ğŸ“ é«˜ç²¾åº¦æ—¶é—´è·å–ç¤ºä¾‹**
```c
#include <stdio.h>
#include <time.h>
#include <unistd.h>

void print_time_info(const char *clock_name, clockid_t clock_id) {
    struct timespec ts;
    
    if (clock_gettime(clock_id, &ts) == 0) {
        printf("%s: %ld.%09ldç§’\n", 
               clock_name, ts.tv_sec, ts.tv_nsec);
    } else {
        printf("%s: è·å–å¤±è´¥\n", clock_name);
    }
}

int main() {
    printf("=== å„ç§é«˜ç²¾åº¦æ—¶é’Ÿå¯¹æ¯” ===\n");
    
    print_time_info("å®æ—¶æ—¶é’Ÿ", CLOCK_REALTIME);
    print_time_info("å•è°ƒæ—¶é’Ÿ", CLOCK_MONOTONIC);
    print_time_info("è¿›ç¨‹CPUæ—¶é—´", CLOCK_PROCESS_CPUTIME_ID);
    
    // åšä¸€äº›CPUå¯†é›†è®¡ç®—
    printf("\næ‰§è¡Œä¸€äº›è®¡ç®—...\n");
    volatile int sum = 0;
    for (int i = 0; i < 1000000; i++) {
        sum += i;
    }
    
    printf("\n=== è®¡ç®—åçš„æ—¶é’Ÿå€¼ ===\n");
    print_time_info("å®æ—¶æ—¶é’Ÿ", CLOCK_REALTIME);
    print_time_info("å•è°ƒæ—¶é’Ÿ", CLOCK_MONOTONIC);
    print_time_info("è¿›ç¨‹CPUæ—¶é—´", CLOCK_PROCESS_CPUTIME_ID);
    
    return 0;
}
```

### 8.2 æ€§èƒ½æµ‹è¯•ä¸æ—¶é—´æµ‹é‡


**ğŸ“ é«˜ç²¾åº¦æ€§èƒ½æµ‹è¯•**
```c
#include <stdio.h>
#include <time.h>

// è®¡ç®—ä¸¤ä¸ªtimespecçš„æ—¶é—´å·®ï¼ˆçº³ç§’ï¼‰
long timespec_diff_ns(struct timespec *start, struct timespec *end) {
    long sec_diff = end->tv_sec - start->tv_sec;
    long nsec_diff = end->tv_nsec - start->tv_nsec;
    return sec_diff * 1000000000L + nsec_diff;
}

int main() {
    struct timespec start, end;
    volatile int result = 0;
    
    // è®°å½•å¼€å§‹æ—¶é—´
    clock_gettime(CLOCK_MONOTONIC, &start);
    
    // è¦æµ‹è¯•çš„ä»£ç æ®µ
    for (int i = 0; i < 1000000; i++) {
        result += i * i;
    }
    
    // è®°å½•ç»“æŸæ—¶é—´
    clock_gettime(CLOCK_MONOTONIC, &end);
    
    // è®¡ç®—æ‰§è¡Œæ—¶é—´
    long elapsed_ns = timespec_diff_ns(&start, &end);
    double elapsed_ms = elapsed_ns / 1000000.0;
    
    printf("è®¡ç®—ç»“æœ: %d\n", result);
    printf("æ‰§è¡Œæ—¶é—´: %ldçº³ç§’\n", elapsed_ns);
    printf("æ‰§è¡Œæ—¶é—´: %.3fæ¯«ç§’\n", elapsed_ms);
    
    return 0;
}
```

### 8.3 æ—¶é’Ÿåˆ†è¾¨ç‡æ£€æµ‹


**ğŸ“ æ£€æµ‹æ—¶é’Ÿç²¾åº¦**
```c
#include <stdio.h>
#include <time.h>

void print_clock_resolution(const char *name, clockid_t clock_id) {
    struct timespec res;
    
    if (clock_getres(clock_id, &res) == 0) {
        double resolution_ns = res.tv_sec * 1000000000.0 + res.tv_nsec;
        printf("%såˆ†è¾¨ç‡: %.0fçº³ç§’\n", name, resolution_ns);
    } else {
        printf("%s: æ— æ³•è·å–åˆ†è¾¨ç‡\n", name);
    }
}

int main() {
    printf("=== ç³»ç»Ÿæ—¶é’Ÿåˆ†è¾¨ç‡ ===\n");
    print_clock_resolution("å®æ—¶æ—¶é’Ÿ", CLOCK_REALTIME);
    print_clock_resolution("å•è°ƒæ—¶é’Ÿ", CLOCK_MONOTONIC);
    print_clock_resolution("è¿›ç¨‹CPUæ—¶é’Ÿ", CLOCK_PROCESS_CPUTIME_ID);
    
    return 0;
}
```

---

## 9. âš¡ å®šæ—¶å™¨ç²¾åº¦ä¸æ€§èƒ½ä¼˜åŒ–


### 9.1 å½±å“å®šæ—¶å™¨ç²¾åº¦çš„å› ç´ 


**ğŸ”¸ ç³»ç»Ÿè´Ÿè½½çš„å½±å“**
```
é«˜è´Ÿè½½ç³»ç»Ÿï¼š
- CPUå¿™äºå¤„ç†å…¶ä»–ä»»åŠ¡
- å®šæ—¶å™¨å¯èƒ½å»¶è¿Ÿè§¦å‘
- ç²¾åº¦ä¸‹é™æ˜æ˜¾

ä½è´Ÿè½½ç³»ç»Ÿï¼š
- CPUæœ‰è¶³å¤Ÿæ—¶é—´å¤„ç†å®šæ—¶å™¨
- ç²¾åº¦æ¥è¿‘ç†è®ºå€¼
- å“åº”æ›´åŠæ—¶
```

**ğŸ“ æµ‹è¯•ç³»ç»Ÿè´Ÿè½½å¯¹å®šæ—¶å™¨çš„å½±å“**
```c
#include <stdio.h>
#include <signal.h>
#include <time.h>
#include <unistd.h>
#include <sys/time.h>

static struct timespec last_time;
static int first_call = 1;

void timer_handler(int sig) {
    struct timespec current_time;
    clock_gettime(CLOCK_MONOTONIC, &current_time);
    
    if (!first_call) {
        long diff_ns = (current_time.tv_sec - last_time.tv_sec) * 1000000000L +
                       (current_time.tv_nsec - last_time.tv_nsec);
        double diff_ms = diff_ns / 1000000.0;
        printf("å®šæ—¶å™¨é—´éš”: %.3fæ¯«ç§’\n", diff_ms);
    } else {
        first_call = 0;
    }
    
    last_time = current_time;
}

int main() {
    timer_t timerid;
    struct sigevent sev;
    struct itimerspec its;
    struct sigaction sa;
    
    // è®¾ç½®ä¿¡å·å¤„ç†
    sa.sa_handler = timer_handler;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = 0;
    sigaction(SIGRTMIN, &sa, NULL);
    
    // åˆ›å»ºå®šæ—¶å™¨
    sev.sigev_notify = SIGEV_SIGNAL;
    sev.sigev_signo = SIGRTMIN;
    timer_create(CLOCK_MONOTONIC, &sev, &timerid);
    
    // è®¾ç½®100æ¯«ç§’é—´éš”çš„å®šæ—¶å™¨
    its.it_value.tv_sec = 0;
    its.it_value.tv_nsec = 100000000;  // 100ms
    its.it_interval.tv_sec = 0;
    its.it_interval.tv_nsec = 100000000;
    
    timer_settime(timerid, 0, &its, NULL);
    
    printf("100mså®šæ—¶å™¨å¯åŠ¨ï¼Œè§‚å¯Ÿå®é™…é—´éš”...\n");
    printf("æŒ‰Ctrl+Cé€€å‡º\n");
    
    while (1) {
        pause();
    }
    
    return 0;
}
```

### 9.2 å®šæ—¶å™¨ç²¾åº¦ä¼˜åŒ–ç­–ç•¥


**ğŸ¯ é€‰æ‹©åˆé€‚çš„æ—¶é’Ÿç±»å‹**
```c
// å¯¹äºé—´éš”æµ‹é‡ï¼Œä½¿ç”¨å•è°ƒæ—¶é’Ÿ
clock_gettime(CLOCK_MONOTONIC, &ts);

// å¯¹äºç»å¯¹æ—¶é—´ï¼Œä½¿ç”¨å®æ—¶æ—¶é’Ÿ
clock_gettime(CLOCK_REALTIME, &ts);

// å¯¹äºCPUæ—¶é—´æµ‹é‡
clock_gettime(CLOCK_PROCESS_CPUTIME_ID, &ts);
```

**ğŸ”§ ç³»ç»Ÿé…ç½®ä¼˜åŒ–**
```bash
# æŸ¥çœ‹å½“å‰æ—¶é’Ÿæº
cat /sys/devices/system/clocksource/clocksource0/current_clocksource

# æŸ¥çœ‹å¯ç”¨æ—¶é’Ÿæº
cat /sys/devices/system/clocksource/clocksource0/available_clocksource

# è®¾ç½®é«˜ç²¾åº¦æ—¶é’Ÿæºï¼ˆéœ€è¦rootæƒé™ï¼‰
echo tsc > /sys/devices/system/clocksource/clocksource0/current_clocksource
```

### 9.3 å®é™…åº”ç”¨ä¸­çš„æƒè¡¡


**âš–ï¸ ç²¾åº¦vsæ€§èƒ½æƒè¡¡**
```
é«˜ç²¾åº¦éœ€æ±‚ï¼š
âœ… ä½¿ç”¨POSIXå®šæ—¶å™¨ + clock_gettime()
âœ… é€‰æ‹©åˆé€‚çš„æ—¶é’Ÿç±»å‹
âš ï¸ æ³¨æ„CPUå¼€é”€å¢åŠ 

ä¸€èˆ¬ç²¾åº¦éœ€æ±‚ï¼š
âœ… ä½¿ç”¨ä¼ ç»Ÿå®šæ—¶å™¨ï¼ˆalarm/setitimerï¼‰
âœ… ä»£ç ç®€å•ï¼Œå¼€é”€è¾ƒå°
âš ï¸ ç²¾åº¦æœ‰é™

å®æ—¶æ€§è¦æ±‚ï¼š
âœ… è€ƒè™‘å®æ—¶å†…æ ¸
âœ… è°ƒæ•´è¿›ç¨‹ä¼˜å…ˆçº§
âœ… ä½¿ç”¨ä¸“ç”¨çš„å®šæ—¶å™¨çº¿ç¨‹
```

**ğŸ“ ç»¼åˆæ€§èƒ½æµ‹è¯•**
```c
#include <stdio.h>
#include <time.h>
#include <sys/time.h>
#include <unistd.h>

void benchmark_time_functions() {
    struct timespec start, end;
    const int iterations = 1000000;
    
    printf("=== æ—¶é—´å‡½æ•°æ€§èƒ½æµ‹è¯• ===\n");
    
    // æµ‹è¯•time()
    clock_gettime(CLOCK_MONOTONIC, &start);
    for (int i = 0; i < iterations; i++) {
        time(NULL);
    }
    clock_gettime(CLOCK_MONOTONIC, &end);
    long time_ns = (end.tv_sec - start.tv_sec) * 1000000000L + 
                   (end.tv_nsec - start.tv_nsec);
    printf("time()è°ƒç”¨%dæ¬¡è€—æ—¶: %ldçº³ç§’ï¼Œå¹³å‡: %.1fçº³ç§’/æ¬¡\n",
           iterations, time_ns, (double)time_ns / iterations);
    
    // æµ‹è¯•gettimeofday()
    clock_gettime(CLOCK_MONOTONIC, &start);
    struct timeval tv;
    for (int i = 0; i < iterations; i++) {
        gettimeofday(&tv, NULL);
    }
    clock_gettime(CLOCK_MONOTONIC, &end);
    long gtod_ns = (end.tv_sec - start.tv_sec) * 1000000000L + 
                   (end.tv_nsec - start.tv_nsec);
    printf("gettimeofday()è°ƒç”¨%dæ¬¡è€—æ—¶: %ldçº³ç§’ï¼Œå¹³å‡: %.1fçº³ç§’/æ¬¡\n",
           iterations, gtod_ns, (double)gtod_ns / iterations);
    
    // æµ‹è¯•clock_gettime()
    clock_gettime(CLOCK_MONOTONIC, &start);
    struct timespec ts;
    for (int i = 0; i < iterations; i++) {
        clock_gettime(CLOCK_REALTIME, &ts);
    }
    clock_gettime(CLOCK_MONOTONIC, &end);
    long cgt_ns = (end.tv_sec - start.tv_sec) * 1000000000L + 
                  (end.tv_nsec - start.tv_nsec);
    printf("clock_gettime()è°ƒç”¨%dæ¬¡è€—æ—¶: %ldçº³ç§’ï¼Œå¹³å‡: %.1fçº³ç§’/æ¬¡\n",
           iterations, cgt_ns, (double)cgt_ns / iterations);
}

int main() {
    benchmark_time_functions();
    return 0;
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ—¶é—´è¡¨ç¤ºï¼šUnixæ—¶é—´æˆ³ã€æ—¶é—´ç»“æ„ä½“ã€é«˜ç²¾åº¦æ—¶é—´
ğŸ”¸ æ—¶é—´è·å–ï¼štime()ã€gettimeofday()ã€clock_gettime()
ğŸ”¸ å»¶æ—¶æ§åˆ¶ï¼šsleep()ã€usleep()ã€nanosleep()
ğŸ”¸ ä¼ ç»Ÿå®šæ—¶å™¨ï¼šalarm()ã€setitimer()
ğŸ”¸ é«˜çº§å®šæ—¶å™¨ï¼štimer_create()ã€timer_settime()
ğŸ”¸ æ—¶é—´è½¬æ¢ï¼štime_tä¸struct tmçš„äº’è½¬
ğŸ”¸ æ—¶åŒºå¤„ç†ï¼šæœ¬åœ°æ—¶é—´ä¸UTCæ—¶é—´çš„è½¬æ¢
ğŸ”¸ ç²¾åº¦ä¼˜åŒ–ï¼šé€‰æ‹©åˆé€‚çš„æ—¶é’Ÿç±»å‹å’Œå®šæ—¶å™¨
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ—¶é—´ç²¾åº¦çš„é€‰æ‹©**
```
ç§’çº§ç²¾åº¦ï¼š
- ä½¿ç”¨time()å’Œsleep()
- é€‚åˆæ—¥å¸¸æ—¶é—´è®°å½•å’Œç®€å•å»¶æ—¶

å¾®ç§’çº§ç²¾åº¦ï¼š
- ä½¿ç”¨gettimeofday()å’Œusleep()  
- é€‚åˆç½‘ç»œç¼–ç¨‹å’Œä¸€èˆ¬æ€§èƒ½æµ‹è¯•

çº³ç§’çº§ç²¾åº¦ï¼š
- ä½¿ç”¨clock_gettime()å’Œnanosleep()
- é€‚åˆé«˜ç²¾åº¦è®¡æ—¶å’Œå®æ—¶ç³»ç»Ÿ
```

**ğŸ”¹ å®šæ—¶å™¨çš„é€‰æ‹©**
```
ç®€å•å®šæ—¶éœ€æ±‚ï¼š
- ä½¿ç”¨alarm()åšè¶…æ—¶æ§åˆ¶
- ä½¿ç”¨setitimer()åšå‘¨æœŸæ€§ä»»åŠ¡

å¤æ‚å®šæ—¶éœ€æ±‚ï¼š
- ä½¿ç”¨POSIXå®šæ—¶å™¨
- æ”¯æŒå¤šä¸ªç‹¬ç«‹å®šæ—¶å™¨
- æ›´çµæ´»çš„é…ç½®é€‰é¡¹
```

**ğŸ”¹ æ—¶åŒºä¸æœ¬åœ°åŒ–**
```
æ˜¾ç¤ºæ—¶é—´ï¼š
- ä½¿ç”¨localtime()è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´
- æ³¨æ„å¤ä»¤æ—¶çš„å½±å“

è®¡ç®—æ—¶é—´é—´éš”ï¼š
- ä½¿ç”¨å•è°ƒæ—¶é’Ÿé¿å…æ—¶é—´è°ƒæ•´å½±å“
- é€‰æ‹©CLOCK_MONOTONICæ—¶é’Ÿç±»å‹
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… æœ€ä½³å®è·µ**
```
æ—¶é—´è·å–ï¼š
- æ˜¾ç¤ºç”¨é€”ï¼štime() + localtime()
- é«˜ç²¾åº¦è®¡æ—¶ï¼šclock_gettime(CLOCK_MONOTONIC)
- æ€§èƒ½æµ‹è¯•ï¼šä½¿ç”¨å•è°ƒæ—¶é’Ÿæµ‹é‡é—´éš”

å»¶æ—¶æ§åˆ¶ï¼š
- ç§’çº§å»¶æ—¶ï¼šsleep()
- é«˜ç²¾åº¦å»¶æ—¶ï¼šnanosleep()
- é¿å…ä½¿ç”¨usleep()ï¼ˆå·²è¿‡æ—¶ï¼‰

å®šæ—¶å™¨é€‰æ‹©ï¼š
- ç®€å•è¶…æ—¶ï¼šalarm() + signal()
- å‘¨æœŸæ€§ä»»åŠ¡ï¼šsetitimer()
- å¤æ‚éœ€æ±‚ï¼šPOSIXå®šæ—¶å™¨
```

**âš ï¸ å¸¸è§é™·é˜±**
```
struct tmä½¿ç”¨ï¼š
- å¹´ä»½ï¼štm_year = å®é™…å¹´ä»½ - 1900
- æœˆä»½ï¼štm_mon = å®é™…æœˆä»½ - 1
- è®°ä½è¿™ä¸¤ä¸ªåç§»ï¼

ä¿¡å·å¤„ç†ï¼š
- ä¿¡å·å¤„ç†å‡½æ•°è¦å°½é‡ç®€å•
- é¿å…åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨ä¸å®‰å…¨çš„å‡½æ•°
- è€ƒè™‘ä½¿ç”¨signalfd()ç­‰ç°ä»£æ¥å£

ç²¾åº¦ç†è§£ï¼š
- ç³»ç»Ÿè´Ÿè½½ä¼šå½±å“å®šæ—¶å™¨ç²¾åº¦
- ä¸è¦æœŸæœ›çº³ç§’çº§çš„ç»å¯¹ç²¾åº¦
- åˆç†è®¾ç½®å®šæ—¶å™¨é—´éš”
```

### 10.4 å­¦ä¹ è¿›é˜¶æ–¹å‘


```
æ·±å…¥ç†è§£ï¼š
ğŸ”¸ Linuxå†…æ ¸æ—¶é—´å­ç³»ç»Ÿæ¶æ„
ğŸ”¸ å®æ—¶ç³»ç»Ÿä¸­çš„æ—¶é—´ç®¡ç†
ğŸ”¸ é«˜æ€§èƒ½å®šæ—¶å™¨å®ç°åŸç†
ğŸ”¸ æ—¶é—´åŒæ­¥åè®®ï¼ˆNTPç­‰ï¼‰

å®è·µåº”ç”¨ï¼š
ğŸ”¸ æ€§èƒ½åˆ†æå·¥å…·å¼€å‘
ğŸ”¸ å®æ—¶æ•°æ®é‡‡é›†ç³»ç»Ÿ
ğŸ”¸ ç½‘ç»œåè®®è¶…æ—¶å¤„ç†
ğŸ”¸ å¤šåª’ä½“åŒæ­¥æ’­æ”¾
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ—¶é—´ç®¡ç†æ˜¯ç³»ç»Ÿç¼–ç¨‹çš„åŸºç¡€æŠ€èƒ½
- æ ¹æ®ç²¾åº¦éœ€æ±‚é€‰æ‹©åˆé€‚çš„å‡½æ•°å’Œæ¥å£
- ç†è§£æ—¶åŒºå’Œæ—¶é—´è½¬æ¢çš„é‡è¦æ€§  
- å®šæ—¶å™¨è®¾è®¡è¦è€ƒè™‘ç³»ç»Ÿè´Ÿè½½çš„å½±å“
- é«˜ç²¾åº¦ä¸ç­‰äºé«˜å‡†ç¡®åº¦ï¼Œè¦åˆç†è®¾ç½®æœŸæœ›