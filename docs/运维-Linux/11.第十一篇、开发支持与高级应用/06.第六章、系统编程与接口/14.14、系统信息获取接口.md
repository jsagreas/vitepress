---
title: 14ã€ç³»ç»Ÿä¿¡æ¯è·å–æ¥å£
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿä¿¡æ¯è·å–æ¦‚è¿°](#1-ç³»ç»Ÿä¿¡æ¯è·å–æ¦‚è¿°)
2. [uname()ç³»ç»Ÿä¿¡æ¯è·å–](#2-unameç³»ç»Ÿä¿¡æ¯è·å–)
3. [sysinfo()ç³»ç»Ÿèµ„æºç»Ÿè®¡](#3-sysinfoç³»ç»Ÿèµ„æºç»Ÿè®¡)
4. [/procæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹è®¿é—®](#4-procæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹è®¿é—®)
5. [ç³»ç»Ÿé…ç½®sysconf()æŸ¥è¯¢](#5-ç³»ç»Ÿé…ç½®sysconfæŸ¥è¯¢)
6. [ç¡¬ä»¶ä¿¡æ¯è·å–æ–¹æ³•](#6-ç¡¬ä»¶ä¿¡æ¯è·å–æ–¹æ³•)
7. [ç³»ç»Ÿè´Ÿè½½ä¸æ€§èƒ½æŒ‡æ ‡è¯»å–](#7-ç³»ç»Ÿè´Ÿè½½ä¸æ€§èƒ½æŒ‡æ ‡è¯»å–)
8. [è¿›ç¨‹èµ„æºä½¿ç”¨getrusage()](#8-è¿›ç¨‹èµ„æºä½¿ç”¨getrusage)
9. [ç³»ç»Ÿé™åˆ¶ä¸é…ç½®å‚æ•°](#9-ç³»ç»Ÿé™åˆ¶ä¸é…ç½®å‚æ•°)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç³»ç»Ÿä¿¡æ¯è·å–æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿä¿¡æ¯è·å–


**ç³»ç»Ÿä¿¡æ¯è·å–**æ˜¯æŒ‡ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€æŸ¥è¯¢æ“ä½œç³»ç»ŸçŠ¶æ€ã€ç¡¬ä»¶é…ç½®ã€èµ„æºä½¿ç”¨æƒ…å†µç­‰ä¿¡æ¯çš„è¿‡ç¨‹ã€‚è¿™å°±åƒç»™ç¨‹åºè£…äº†ä¸€åŒ"çœ¼ç›"ï¼Œè®©å®ƒèƒ½"çœ‹è§"è‡ªå·±è¿è¡Œçš„ç¯å¢ƒã€‚

**ä¸ºä»€ä¹ˆéœ€è¦è·å–ç³»ç»Ÿä¿¡æ¯ï¼Ÿ**
```
å®é™…åº”ç”¨åœºæ™¯ï¼š
â€¢ æ€§èƒ½ç›‘æ§ç¨‹åºï¼šéœ€è¦çŸ¥é“CPUä½¿ç”¨ç‡ã€å†…å­˜å ç”¨
â€¢ ç³»ç»Ÿç®¡ç†å·¥å…·ï¼šéœ€è¦æŸ¥çœ‹ç¡¬ä»¶é…ç½®ã€ç³»ç»Ÿç‰ˆæœ¬
â€¢ èµ„æºç®¡ç†è½¯ä»¶ï¼šéœ€è¦äº†è§£ç£ç›˜ç©ºé—´ã€ç½‘ç»œçŠ¶æ€
â€¢ æ¸¸æˆæˆ–åº”ç”¨ï¼šéœ€è¦æ£€æµ‹ç¡¬ä»¶æ˜¯å¦æ»¡è¶³è¿è¡Œè¦æ±‚
```

### 1.2 Linuxç³»ç»Ÿä¿¡æ¯è·å–çš„ç‰¹ç‚¹


**Linuxçš„å“²å­¦**ï¼šä¸€åˆ‡çš†æ–‡ä»¶
```
ç³»ç»Ÿä¿¡æ¯çš„ä¸¤ç§è·å–æ–¹å¼ï¼š

æ–¹å¼ä¸€ï¼šç³»ç»Ÿè°ƒç”¨æ¥å£
â€¢ uname() - è·å–ç³»ç»ŸåŸºæœ¬ä¿¡æ¯
â€¢ sysinfo() - è·å–ç³»ç»Ÿèµ„æºç»Ÿè®¡
â€¢ getrusage() - è·å–è¿›ç¨‹èµ„æºä½¿ç”¨æƒ…å†µ

æ–¹å¼äºŒï¼šæ–‡ä»¶ç³»ç»Ÿæ¥å£  
â€¢ /proc - è¿›ç¨‹å’Œç³»ç»Ÿä¿¡æ¯çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ
â€¢ /sys - ç¡¬ä»¶è®¾å¤‡ä¿¡æ¯çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ
â€¢ /dev - è®¾å¤‡æ–‡ä»¶
```

### 1.3 ç³»ç»Ÿä¿¡æ¯çš„åˆ†ç±»


| ä¿¡æ¯ç±»å‹ | **åŒ…å«å†…å®¹** | **è·å–æ–¹å¼** | **åº”ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| ğŸ–¥ï¸ **ç³»ç»ŸåŸºç¡€ä¿¡æ¯** | `æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€å†…æ ¸ç‰ˆæœ¬ã€ä¸»æœºå` | `uname()` | `ç³»ç»Ÿå…¼å®¹æ€§æ£€æŸ¥` |
| ğŸ“Š **èµ„æºç»Ÿè®¡ä¿¡æ¯** | `å†…å­˜ä½¿ç”¨ã€è´Ÿè½½ã€è¿›ç¨‹æ•°` | `sysinfo()` | `æ€§èƒ½ç›‘æ§` |
| ğŸ”§ **ç¡¬ä»¶é…ç½®ä¿¡æ¯** | `CPUå‹å·ã€å†…å­˜å¤§å°ã€ç£ç›˜ä¿¡æ¯` | `/procã€/sysæ–‡ä»¶ç³»ç»Ÿ` | `ç¡¬ä»¶æ£€æµ‹` |
| âš™ï¸ **ç³»ç»Ÿé…ç½®å‚æ•°** | `é¡µé¢å¤§å°ã€æœ€å¤§æ–‡ä»¶æ•°ã€æ—¶é’Ÿé¢‘ç‡` | `sysconf()` | `ç¨‹åºä¼˜åŒ–é…ç½®` |
| ğŸ“ˆ **è¿è¡Œæ—¶çŠ¶æ€** | `è¿›ç¨‹èµ„æºä½¿ç”¨ã€ç³»ç»Ÿè´Ÿè½½` | `getrusage()ã€/proc/loadavg` | `æ€§èƒ½åˆ†æ` |

---

## 2. ğŸ–¥ï¸ uname()ç³»ç»Ÿä¿¡æ¯è·å–


### 2.1 uname()å‡½æ•°æ¦‚è¿°


**uname()** æ˜¯è·å–ç³»ç»ŸåŸºæœ¬ä¿¡æ¯çš„æ ‡å‡†æ¥å£ï¼Œå°±åƒç³»ç»Ÿçš„"èº«ä»½è¯"ï¼ŒåŒ…å«äº†æ“ä½œç³»ç»Ÿçš„åŸºæœ¬èº«ä»½ä¿¡æ¯ã€‚

```c
#include <sys/utsname.h>

int uname(struct utsname *buf);
```

**å‡½æ•°ç‰¹ç‚¹ï¼š**
- **è¿”å›å€¼**ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1
- **å‚æ•°**ï¼šæŒ‡å‘ `utsname` ç»“æ„ä½“çš„æŒ‡é’ˆ
- **ä½œç”¨**ï¼šä¸€æ¬¡æ€§è·å–ç³»ç»Ÿçš„æ ¸å¿ƒèº«ä»½ä¿¡æ¯

### 2.2 utsnameç»“æ„ä½“è¯¦è§£


```c
struct utsname {
    char sysname[];    // æ“ä½œç³»ç»Ÿåç§°ï¼Œå¦‚"Linux"
    char nodename[];   // ç½‘ç»œèŠ‚ç‚¹åç§°ï¼ˆä¸»æœºåï¼‰
    char release[];    // æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆæœ¬å·
    char version[];    // æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯å’Œç¼–è¯‘æ—¶é—´
    char machine[];    // ç¡¬ä»¶æ¶æ„ç±»å‹ï¼Œå¦‚"x86_64"
    #ifdef _GNU_SOURCE
    char domainname[]; // NISåŸŸåï¼ˆGNUæ‰©å±•ï¼‰
    #endif
};
```

**å­—æ®µå«ä¹‰è§£é‡Šï¼š**
```
sysnameï¼š  "Linux" - å‘Šè¯‰ä½ è¿™æ˜¯Linuxç³»ç»Ÿ
nodenameï¼š "myserver" - ä¸»æœºåï¼Œç½‘ç»œä¸­çš„æ ‡è¯†
releaseï¼š  "5.4.0-42-generic" - å†…æ ¸ç‰ˆæœ¬å·
versionï¼š  "#46-Ubuntu SMP Fri Jul 10 00:24:02 UTC 2020" - è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯
machineï¼š  "x86_64" - CPUæ¶æ„ï¼Œ64ä½x86å¤„ç†å™¨
```

### 2.3 å®é™…åº”ç”¨ç¤ºä¾‹


```c
#include <stdio.h>
#include <sys/utsname.h>
#include <stdlib.h>

int main() {
    struct utsname sys_info;
    
    // è·å–ç³»ç»Ÿä¿¡æ¯
    if (uname(&sys_info) == -1) {
        perror("uname failed");
        return 1;
    }
    
    // è¾“å‡ºç³»ç»Ÿä¿¡æ¯
    printf("ç³»ç»Ÿä¿¡æ¯æŠ¥å‘Š\n");
    printf("================\n");
    printf("æ“ä½œç³»ç»Ÿ:   %s\n", sys_info.sysname);
    printf("ä¸»æœºå:     %s\n", sys_info.nodename);
    printf("å†…æ ¸ç‰ˆæœ¬:   %s\n", sys_info.release);
    printf("ç‰ˆæœ¬ä¿¡æ¯:   %s\n", sys_info.version);
    printf("ç¡¬ä»¶æ¶æ„:   %s\n", sys_info.machine);
    
    return 0;
}
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
ç³»ç»Ÿä¿¡æ¯æŠ¥å‘Š
================
æ“ä½œç³»ç»Ÿ:   Linux
ä¸»æœºå:     ubuntu-server
å†…æ ¸ç‰ˆæœ¬:   5.4.0-42-generic
ç‰ˆæœ¬ä¿¡æ¯:   #46-Ubuntu SMP Fri Jul 10 00:24:02 UTC 2020
ç¡¬ä»¶æ¶æ„:   x86_64
```

### 2.4 uname()çš„å®é™…åº”ç”¨åœºæ™¯


**åœºæ™¯1ï¼šç³»ç»Ÿå…¼å®¹æ€§æ£€æŸ¥**
```c
// æ£€æŸ¥æ˜¯å¦ä¸ºLinuxç³»ç»Ÿ
if (strcmp(sys_info.sysname, "Linux") == 0) {
    printf("æ£€æµ‹åˆ°Linuxç³»ç»Ÿï¼Œç»§ç»­æ‰§è¡Œ...\n");
} else {
    printf("è­¦å‘Šï¼šéLinuxç³»ç»Ÿï¼Œå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜\n");
}

// æ£€æŸ¥æ¶æ„ç±»å‹
if (strcmp(sys_info.machine, "x86_64") == 0) {
    printf("64ä½ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨é«˜çº§åŠŸèƒ½\n");
} else {
    printf("32ä½ç³»ç»Ÿï¼Œä½¿ç”¨å…¼å®¹æ¨¡å¼\n");
}
```

**åœºæ™¯2ï¼šæ—¥å¿—è®°å½•å’Œè°ƒè¯•**
```c
// åœ¨æ—¥å¿—ä¸­è®°å½•ç³»ç»Ÿç¯å¢ƒä¿¡æ¯
fprintf(log_file, "[%s] ç¨‹åºå¯åŠ¨ - ç³»ç»Ÿ: %s %s, ä¸»æœº: %s\n", 
        timestamp, sys_info.sysname, sys_info.release, sys_info.nodename);
```

---

## 3. ğŸ“Š sysinfo()ç³»ç»Ÿèµ„æºç»Ÿè®¡


### 3.1 sysinfo()å‡½æ•°æ¦‚è¿°


**sysinfo()** æä¾›ç³»ç»Ÿèµ„æºçš„å®æ—¶ç»Ÿè®¡ä¿¡æ¯ï¼Œå°±åƒç³»ç»Ÿçš„"ä½“æ£€æŠ¥å‘Š"ï¼Œå‘Šè¯‰ä½ å†…å­˜ç”¨äº†å¤šå°‘ã€ç³»ç»Ÿè´Ÿè½½å¦‚ä½•ç­‰ã€‚

```c
#include <sys/sysinfo.h>

int sysinfo(struct sysinfo *info);
```

**å‡½æ•°ç‰¹ç‚¹ï¼š**
- **å®æ—¶æ€§**ï¼šè·å–å½“å‰æ—¶åˆ»çš„ç³»ç»ŸçŠ¶æ€
- **å…¨é¢æ€§**ï¼šåŒ…å«å†…å­˜ã€è´Ÿè½½ã€è¿›ç¨‹ç­‰å¤šç»´åº¦ä¿¡æ¯
- **Linuxç‰¹æœ‰**ï¼šè¿™æ˜¯Linuxç³»ç»Ÿç‰¹æœ‰çš„æ¥å£

### 3.2 sysinfoç»“æ„ä½“è¯¦è§£


```c
struct sysinfo {
    long uptime;        // ç³»ç»Ÿå¯åŠ¨è‡³ä»Šçš„ç§’æ•°
    unsigned long loads[3];  // 1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½
    unsigned long totalram;  // æ€»å†…å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    unsigned long freeram;   // å¯ç”¨å†…å­˜å¤§å°
    unsigned long sharedram; // å…±äº«å†…å­˜å¤§å°
    unsigned long bufferram; // ç¼“å†²åŒºå†…å­˜å¤§å°
    unsigned long totalswap; // æ€»äº¤æ¢ç©ºé—´å¤§å°
    unsigned long freeswap;  // å¯ç”¨äº¤æ¢ç©ºé—´å¤§å°
    unsigned short procs;    // å½“å‰è¿›ç¨‹æ•°
    unsigned long totalhigh; // é«˜å†…å­˜æ€»é‡
    unsigned long freehigh;  // é«˜å†…å­˜å¯ç”¨é‡
    unsigned int mem_unit;   // å†…å­˜å•ä½å¤§å°ï¼ˆå­—èŠ‚ï¼‰
};
```

**å­—æ®µå«ä¹‰è§£é‡Šï¼š**
```
uptimeï¼š    ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Œå•ä½ç§’
loads[3]ï¼š  ç³»ç»Ÿè´Ÿè½½ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºç³»ç»Ÿè¶Šå¿™
totalramï¼š  æ€»å†…å­˜ = å·²ç”¨å†…å­˜ + å¯ç”¨å†…å­˜  
freeramï¼š   ç©ºé—²å†…å­˜ï¼Œç«‹å³å¯ç”¨çš„å†…å­˜
totalswapï¼š è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œç¡¬ç›˜ä¸Šçš„æ‰©å±•å†…å­˜
procsï¼š     å½“å‰è¿è¡Œçš„è¿›ç¨‹æ€»æ•°
```

### 3.3 å®é™…åº”ç”¨ç¤ºä¾‹


```c
#include <stdio.h>
#include <sys/sysinfo.h>
#include <stdlib.h>

void print_memory_info(struct sysinfo *si) {
    printf("\nå†…å­˜ä½¿ç”¨æƒ…å†µ\n");
    printf("=============\n");
    printf("æ€»å†…å­˜:     %.2f MB\n", si->totalram / 1024.0 / 1024.0);
    printf("å¯ç”¨å†…å­˜:   %.2f MB\n", si->freeram / 1024.0 / 1024.0);
    printf("å·²ç”¨å†…å­˜:   %.2f MB\n", 
           (si->totalram - si->freeram) / 1024.0 / 1024.0);
    printf("å†…å­˜ä½¿ç”¨ç‡: %.1f%%\n", 
           (si->totalram - si->freeram) * 100.0 / si->totalram);
}

void print_system_load(struct sysinfo *si) {
    printf("\nç³»ç»Ÿè´Ÿè½½\n");
    printf("=========\n");
    printf("1åˆ†é’Ÿè´Ÿè½½:  %.2f\n", si->loads[0] / 65536.0);
    printf("5åˆ†é’Ÿè´Ÿè½½:  %.2f\n", si->loads[1] / 65536.0);
    printf("15åˆ†é’Ÿè´Ÿè½½: %.2f\n", si->loads[2] / 65536.0);
}

int main() {
    struct sysinfo si;
    
    if (sysinfo(&si) == -1) {
        perror("sysinfo failed");
        return 1;
    }
    
    // ç³»ç»Ÿè¿è¡Œæ—¶é—´
    int days = si.uptime / 86400;
    int hours = (si.uptime % 86400) / 3600;
    int minutes = (si.uptime % 3600) / 60;
    
    printf("ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š\n");
    printf("=============\n");
    printf("è¿è¡Œæ—¶é—´: %då¤© %då°æ—¶ %dåˆ†é’Ÿ\n", days, hours, minutes);
    printf("è¿›ç¨‹æ•°é‡: %d\n", si.procs);
    
    print_memory_info(&si);
    print_system_load(&si);
    
    return 0;
}
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š
=============
è¿è¡Œæ—¶é—´: 15å¤© 8å°æ—¶ 32åˆ†é’Ÿ
è¿›ç¨‹æ•°é‡: 156

å†…å­˜ä½¿ç”¨æƒ…å†µ
=============
æ€»å†…å­˜:     7.68 GB
å¯ç”¨å†…å­˜:   3.21 GB
å·²ç”¨å†…å­˜:   4.47 GB
å†…å­˜ä½¿ç”¨ç‡: 58.2%

ç³»ç»Ÿè´Ÿè½½
=========
1åˆ†é’Ÿè´Ÿè½½:  0.85
5åˆ†é’Ÿè´Ÿè½½:  0.72
15åˆ†é’Ÿè´Ÿè½½: 0.68
```

### 3.4 ç³»ç»Ÿè´Ÿè½½çš„ç†è§£


**è´Ÿè½½å€¼çš„å«ä¹‰ï¼š**
```
è´Ÿè½½ = ç­‰å¾…CPUæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡

å•æ ¸ç³»ç»Ÿï¼š
â€¢ è´Ÿè½½ 0.0 = å®Œå…¨ç©ºé—²
â€¢ è´Ÿè½½ 1.0 = å®Œå…¨é¥±å’Œï¼Œåˆšå¥½ä¸ç”¨ç­‰å¾…
â€¢ è´Ÿè½½ 2.0 = è¶…è½½100%ï¼Œä»»åŠ¡éœ€è¦ç­‰å¾…

å¤šæ ¸ç³»ç»Ÿï¼š
â€¢ 4æ ¸ç³»ç»Ÿè´Ÿè½½4.0 = å®Œå…¨é¥±å’Œ
â€¢ 4æ ¸ç³»ç»Ÿè´Ÿè½½2.0 = 50%åˆ©ç”¨ç‡
```

**è´Ÿè½½è¯„ä¼°æ ‡å‡†ï¼š**
- **0.0-0.7**ï¼šç³»ç»Ÿç©ºé—²ï¼Œæ€§èƒ½è‰¯å¥½
- **0.7-1.0**ï¼šç³»ç»Ÿç¹å¿™ä½†æ­£å¸¸
- **1.0-2.0**ï¼šç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ï¼Œéœ€è¦å…³æ³¨
- **>2.0**ï¼šç³»ç»Ÿä¸¥é‡è¿‡è½½ï¼Œéœ€è¦ä¼˜åŒ–

---

## 4. ğŸ“ /procæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹è®¿é—®


### 4.1 /procæ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°


**/procæ–‡ä»¶ç³»ç»Ÿ**æ˜¯Linuxæä¾›çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œå°±åƒç³»ç»Ÿçš„"ä¿¡æ¯å¤§å…"ï¼ŒæŠŠå†…æ ¸ä¸­çš„å„ç§ä¿¡æ¯ä»¥æ–‡ä»¶çš„å½¢å¼å±•ç°å‡ºæ¥ã€‚

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
```
è™šæ‹Ÿæ€§è´¨ï¼šæ–‡ä»¶å¹¶ä¸å®é™…å­˜åœ¨äºç¡¬ç›˜ä¸Š
å®æ—¶æ›´æ–°ï¼šå†…å®¹éšç³»ç»ŸçŠ¶æ€å®æ—¶å˜åŒ–
æ˜“äºè®¿é—®ï¼šå¯ä»¥ç”¨æ™®é€šæ–‡ä»¶æ“ä½œæ¥è¯»å–
ä¿¡æ¯ä¸°å¯Œï¼šåŒ…å«ç³»ç»Ÿå’Œè¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯
```

### 4.2 é‡è¦çš„/procæ–‡ä»¶ä»‹ç»


| æ–‡ä»¶è·¯å¾„ | **ä¿¡æ¯å†…å®¹** | **åº”ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| `/proc/cpuinfo` | `CPUè¯¦ç»†ä¿¡æ¯` | `ç¡¬ä»¶æ£€æµ‹ã€æ€§èƒ½ä¼˜åŒ–` |
| `/proc/meminfo` | `å†…å­˜è¯¦ç»†ç»Ÿè®¡` | `å†…å­˜ç›‘æ§ã€å®¹é‡è§„åˆ’` |
| `/proc/loadavg` | `ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼` | `æ€§èƒ½ç›‘æ§ã€è´Ÿè½½å‡è¡¡` |
| `/proc/stat` | `CPUå’Œç³»ç»Ÿç»Ÿè®¡` | `æ€§èƒ½åˆ†æã€èµ„æºç›‘æ§` |
| `/proc/uptime` | `ç³»ç»Ÿè¿è¡Œæ—¶é—´` | `å¯ç”¨æ€§ç›‘æ§` |
| `/proc/version` | `å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯` | `ç³»ç»Ÿè¯†åˆ«ã€å…¼å®¹æ€§æ£€æŸ¥` |
| `/proc/[pid]/` | `ç‰¹å®šè¿›ç¨‹ä¿¡æ¯` | `è¿›ç¨‹ç›‘æ§ã€è°ƒè¯•åˆ†æ` |

### 4.3 è¯»å–/procæ–‡ä»¶çš„æ–¹æ³•


**åŸºæœ¬è¯»å–ç¤ºä¾‹ï¼š**
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// è¯»å–CPUä¿¡æ¯
void read_cpu_info() {
    FILE *fp;
    char line[256];
    int cpu_count = 0;
    
    fp = fopen("/proc/cpuinfo", "r");
    if (fp == NULL) {
        perror("æ— æ³•æ‰“å¼€/proc/cpuinfo");
        return;
    }
    
    printf("CPUä¿¡æ¯\n");
    printf("=======\n");
    
    while (fgets(line, sizeof(line), fp)) {
        if (strstr(line, "processor") != NULL) {
            cpu_count++;
        } else if (strstr(line, "model name") != NULL) {
            printf("CPUå‹å·: %s", strchr(line, ':') + 2);
        } else if (strstr(line, "cpu MHz") != NULL) {
            printf("CPUé¢‘ç‡: %s", strchr(line, ':') + 2);
        }
    }
    
    printf("CPUæ ¸å¿ƒæ•°: %d\n", cpu_count);
    fclose(fp);
}

// è¯»å–å†…å­˜ä¿¡æ¯
void read_memory_info() {
    FILE *fp;
    char line[256];
    long total_mem = 0, free_mem = 0, available_mem = 0;
    
    fp = fopen("/proc/meminfo", "r");
    if (fp == NULL) {
        perror("æ— æ³•æ‰“å¼€/proc/meminfo");
        return;
    }
    
    while (fgets(line, sizeof(line), fp)) {
        if (sscanf(line, "MemTotal: %ld kB", &total_mem) == 1) {
            continue;
        } else if (sscanf(line, "MemFree: %ld kB", &free_mem) == 1) {
            continue;
        } else if (sscanf(line, "MemAvailable: %ld kB", &available_mem) == 1) {
            continue;
        }
    }
    
    printf("\nè¯¦ç»†å†…å­˜ä¿¡æ¯\n");
    printf("=============\n");
    printf("æ€»å†…å­˜:     %.2f GB\n", total_mem / 1024.0 / 1024.0);
    printf("ç©ºé—²å†…å­˜:   %.2f GB\n", free_mem / 1024.0 / 1024.0);
    printf("å¯ç”¨å†…å­˜:   %.2f GB\n", available_mem / 1024.0 / 1024.0);
    
    fclose(fp);
}
```

### 4.4 è¿›ç¨‹ä¿¡æ¯çš„è·å–


**/proc/[pid]/** ç›®å½•åŒ…å«äº†ç‰¹å®šè¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼š

```
/proc/1234/ç›®å½•ç»“æ„ï¼š
â”œâ”€â”€ cmdline     # å‘½ä»¤è¡Œå‚æ•°
â”œâ”€â”€ status      # è¿›ç¨‹çŠ¶æ€ä¿¡æ¯
â”œâ”€â”€ stat        # è¿›ç¨‹ç»Ÿè®¡ä¿¡æ¯
â”œâ”€â”€ mem         # è¿›ç¨‹å†…å­˜æ˜ åƒ
â”œâ”€â”€ maps        # å†…å­˜æ˜ å°„
â”œâ”€â”€ fd/         # æ–‡ä»¶æè¿°ç¬¦ç›®å½•
â””â”€â”€ cwd         # å½“å‰å·¥ä½œç›®å½•
```

**è¯»å–è¿›ç¨‹ä¿¡æ¯ç¤ºä¾‹ï¼š**
```c
void read_process_info(int pid) {
    char path[256];
    char line[256];
    FILE *fp;
    
    // è¯»å–è¿›ç¨‹çŠ¶æ€
    snprintf(path, sizeof(path), "/proc/%d/status", pid);
    fp = fopen(path, "r");
    if (fp == NULL) {
        printf("è¿›ç¨‹ %d ä¸å­˜åœ¨\n", pid);
        return;
    }
    
    printf("è¿›ç¨‹ %d çš„ä¿¡æ¯\n", pid);
    printf("==============\n");
    
    while (fgets(line, sizeof(line), fp)) {
        if (strstr(line, "Name:") != NULL) {
            printf("è¿›ç¨‹å: %s", strchr(line, '\t') + 1);
        } else if (strstr(line, "VmSize:") != NULL) {
            printf("è™šæ‹Ÿå†…å­˜: %s", strchr(line, '\t') + 1);
        } else if (strstr(line, "VmRSS:") != NULL) {
            printf("ç‰©ç†å†…å­˜: %s", strchr(line, '\t') + 1);
        }
    }
    
    fclose(fp);
}
```

---

## 5. âš™ï¸ ç³»ç»Ÿé…ç½®sysconf()æŸ¥è¯¢


### 5.1 sysconf()å‡½æ•°æ¦‚è¿°


**sysconf()** ç”¨äºæŸ¥è¯¢ç³»ç»Ÿçš„é…ç½®å‚æ•°å’Œé™åˆ¶å€¼ï¼Œå°±åƒè¯¢é—®ç³»ç»Ÿ"ä½ çš„å„ç§é™åˆ¶å’Œé…ç½®æ˜¯ä»€ä¹ˆï¼Ÿ"

```c
#include <unistd.h>

long sysconf(int name);
```

**å‡½æ•°ç‰¹ç‚¹ï¼š**
- **è¿”å›å€¼**ï¼šæˆåŠŸè¿”å›é…ç½®å€¼ï¼Œå¤±è´¥è¿”å›-1
- **å‚æ•°**ï¼šé¢„å®šä¹‰çš„é…ç½®å‚æ•°åç§°
- **ç”¨é€”**ï¼šè·å–ç³»ç»Ÿé™åˆ¶ã€é¡µé¢å¤§å°ã€æ—¶é’Ÿé¢‘ç‡ç­‰

### 5.2 å¸¸ç”¨çš„sysconfå‚æ•°


| å‚æ•°åç§° | **å«ä¹‰** | **åº”ç”¨åœºæ™¯** |
|---------|---------|-------------|
| `_SC_PAGE_SIZE` | `å†…å­˜é¡µé¢å¤§å°` | `å†…å­˜ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–` |
| `_SC_NPROCESSORS_ONLN` | `åœ¨çº¿CPUæ ¸å¿ƒæ•°` | `å¹¶è¡Œè®¡ç®—ã€çº¿ç¨‹æ± å¤§å°` |
| `_SC_OPEN_MAX` | `è¿›ç¨‹æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°` | `æ–‡ä»¶æ“ä½œã€èµ„æºç®¡ç†` |
| `_SC_ARG_MAX` | `å‘½ä»¤è¡Œå‚æ•°æœ€å¤§é•¿åº¦` | `å‚æ•°å¤„ç†ã€å‘½ä»¤æ‰§è¡Œ` |
| `_SC_CLK_TCK` | `æ—¶é’Ÿé¢‘ç‡ï¼ˆæ¯ç§’æ»´ç­”æ•°ï¼‰` | `æ—¶é—´è®¡ç®—ã€æ€§èƒ½æµ‹é‡` |
| `_SC_PHYS_PAGES` | `ç‰©ç†å†…å­˜é¡µé¢æ•°` | `å†…å­˜å®¹é‡è®¡ç®—` |
| `_SC_AVPHYS_PAGES` | `å¯ç”¨ç‰©ç†å†…å­˜é¡µé¢æ•°` | `å†…å­˜å¯ç”¨æ€§æ£€æŸ¥` |

### 5.3 å®é™…åº”ç”¨ç¤ºä¾‹


```c
#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>

void print_system_config() {
    long page_size, cpu_count, max_files, clock_ticks;
    long total_pages, avail_pages;
    
    // è·å–å„ç§ç³»ç»Ÿé…ç½®
    page_size = sysconf(_SC_PAGE_SIZE);
    cpu_count = sysconf(_SC_NPROCESSORS_ONLN);
    max_files = sysconf(_SC_OPEN_MAX);
    clock_ticks = sysconf(_SC_CLK_TCK);
    total_pages = sysconf(_SC_PHYS_PAGES);
    avail_pages = sysconf(_SC_AVPHYS_PAGES);
    
    printf("ç³»ç»Ÿé…ç½®ä¿¡æ¯\n");
    printf("=============\n");
    printf("å†…å­˜é¡µé¢å¤§å°:     %ld å­—èŠ‚ (%ld KB)\n", 
           page_size, page_size / 1024);
    printf("CPUæ ¸å¿ƒæ•°:       %ld ä¸ª\n", cpu_count);
    printf("æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°:   %ld ä¸ª\n", max_files);
    printf("æ—¶é’Ÿé¢‘ç‡:        %ld Hz\n", clock_ticks);
    
    if (total_pages > 0 && page_size > 0) {
        printf("ç‰©ç†å†…å­˜æ€»é‡:    %.2f GB\n", 
               (total_pages * page_size) / 1024.0 / 1024.0 / 1024.0);
        printf("å¯ç”¨ç‰©ç†å†…å­˜:    %.2f GB\n", 
               (avail_pages * page_size) / 1024.0 / 1024.0 / 1024.0);
    }
}

// æ ¹æ®CPUæ ¸å¿ƒæ•°åˆ›å»ºæœ€ä¼˜çº¿ç¨‹æ•°
int get_optimal_thread_count() {
    long cpu_count = sysconf(_SC_NPROCESSORS_ONLN);
    if (cpu_count == -1) {
        return 4; // é»˜è®¤å€¼
    }
    
    // é€šå¸¸çº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° + 1 (å¯¹äºCPUå¯†é›†å‹ä»»åŠ¡)
    return (int)cpu_count + 1;
}

int main() {
    print_system_config();
    
    printf("\næ¨èé…ç½®\n");
    printf("=========\n");
    printf("æœ€ä¼˜çº¿ç¨‹æ•°: %d\n", get_optimal_thread_count());
    
    return 0;
}
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
ç³»ç»Ÿé…ç½®ä¿¡æ¯
=============
å†…å­˜é¡µé¢å¤§å°:     4096 å­—èŠ‚ (4 KB)
CPUæ ¸å¿ƒæ•°:       8 ä¸ª
æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°:   1024 ä¸ª
æ—¶é’Ÿé¢‘ç‡:        100 Hz
ç‰©ç†å†…å­˜æ€»é‡:    15.64 GB
å¯ç”¨ç‰©ç†å†…å­˜:    8.32 GB

æ¨èé…ç½®
=========
æœ€ä¼˜çº¿ç¨‹æ•°: 9
```

### 5.4 sysconfçš„å®é™…åº”ç”¨æŠ€å·§


**å†…å­˜å¯¹é½ä¼˜åŒ–ï¼š**
```c
// æŒ‰é¡µé¢å¤§å°å¯¹é½å†…å­˜åˆ†é…
void* allocate_aligned_memory(size_t size) {
    long page_size = sysconf(_SC_PAGE_SIZE);
    if (page_size == -1) page_size = 4096; // é»˜è®¤4KB
    
    // å‘ä¸Šå¯¹é½åˆ°é¡µé¢è¾¹ç•Œ
    size_t aligned_size = ((size + page_size - 1) / page_size) * page_size;
    return malloc(aligned_size);
}
```

**åŠ¨æ€è°ƒæ•´å¹¶å‘åº¦ï¼š**
```c
// æ ¹æ®CPUæ ¸å¿ƒæ•°åŠ¨æ€è°ƒæ•´å·¥ä½œçº¿ç¨‹
int setup_worker_threads() {
    long cpu_count = sysconf(_SC_NPROCESSORS_ONLN);
    if (cpu_count <= 0) cpu_count = 1;
    
    // I/Oå¯†é›†å‹ä»»åŠ¡å¯ä»¥è®¾ç½®æ›´å¤šçº¿ç¨‹
    int thread_count = cpu_count * 2;
    
    printf("æ£€æµ‹åˆ° %ld ä¸ªCPUæ ¸å¿ƒï¼Œåˆ›å»º %d ä¸ªå·¥ä½œçº¿ç¨‹\n", 
           cpu_count, thread_count);
    
    return thread_count;
}
```

---

## 6. ğŸ”§ ç¡¬ä»¶ä¿¡æ¯è·å–æ–¹æ³•


### 6.1 ç¡¬ä»¶ä¿¡æ¯è·å–æ¦‚è¿°


Linuxç³»ç»Ÿæä¾›äº†å¤šç§æ–¹å¼æ¥è·å–ç¡¬ä»¶ä¿¡æ¯ï¼Œä¸»è¦é€šè¿‡è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ¥å®ç°ï¼š

```
ç¡¬ä»¶ä¿¡æ¯è·å–é€”å¾„ï¼š
/proc/cpuinfo    â†’ CPUè¯¦ç»†ä¿¡æ¯
/proc/meminfo    â†’ å†…å­˜ä¿¡æ¯
/proc/devices    â†’ è®¾å¤‡åˆ—è¡¨
/sys/class/      â†’ è®¾å¤‡åˆ†ç±»ä¿¡æ¯
/sys/block/      â†’ å—è®¾å¤‡ä¿¡æ¯
```

### 6.2 CPUä¿¡æ¯è·å–


**è·å–CPUè¯¦ç»†ä¿¡æ¯ï¼š**
```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

typedef struct {
    int processor_id;
    char model_name[128];
    float cpu_mhz;
    int cache_size;
    int cpu_cores;
    int siblings;
} cpu_info_t;

void parse_cpu_info() {
    FILE *fp;
    char line[256];
    cpu_info_t cpu = {0};
    int cpu_count = 0;
    
    fp = fopen("/proc/cpuinfo", "r");
    if (fp == NULL) {
        perror("æ— æ³•è¯»å–CPUä¿¡æ¯");
        return;
    }
    
    printf("CPUç¡¬ä»¶ä¿¡æ¯\n");
    printf("============\n");
    
    while (fgets(line, sizeof(line), fp)) {
        if (strstr(line, "processor") && strstr(line, ":")) {
            sscanf(line, "processor\t: %d", &cpu.processor_id);
            cpu_count++;
        } else if (strstr(line, "model name") && strstr(line, ":")) {
            char *start = strchr(line, ':') + 2;
            start[strlen(start)-1] = '\0'; // å»æ‰æ¢è¡Œç¬¦
            strcpy(cpu.model_name, start);
        } else if (strstr(line, "cpu MHz") && strstr(line, ":")) {
            sscanf(line, "cpu MHz\t: %f", &cpu.cpu_mhz);
        } else if (strstr(line, "cache size") && strstr(line, ":")) {
            sscanf(line, "cache size\t: %d KB", &cpu.cache_size);
        } else if (strstr(line, "cpu cores") && strstr(line, ":")) {
            sscanf(line, "cpu cores\t: %d", &cpu.cpu_cores);
        } else if (strstr(line, "siblings") && strstr(line, ":")) {
            sscanf(line, "siblings\t: %d", &cpu.siblings);
        }
    }
    
    printf("CPUå‹å·:      %s\n", cpu.model_name);
    printf("CPUé¢‘ç‡:      %.0f MHz\n", cpu.cpu_mhz);
    printf("ç¼“å­˜å¤§å°:     %d KB\n", cpu.cache_size);
    printf("ç‰©ç†æ ¸å¿ƒ:     %d ä¸ª\n", cpu.cpu_cores);
    printf("é€»è¾‘æ ¸å¿ƒ:     %d ä¸ª\n", cpu.siblings);
    printf("å¤„ç†å™¨æ•°é‡:   %d ä¸ª\n", cpu_count);
    
    // åˆ¤æ–­æ˜¯å¦æ”¯æŒè¶…çº¿ç¨‹
    if (cpu.siblings > cpu.cpu_cores) {
        printf("è¶…çº¿ç¨‹æ”¯æŒ:   æ˜¯ (æ¯ä¸ªç‰©ç†æ ¸å¿ƒ%dä¸ªçº¿ç¨‹)\n", 
               cpu.siblings / cpu.cpu_cores);
    } else {
        printf("è¶…çº¿ç¨‹æ”¯æŒ:   å¦\n");
    }
    
    fclose(fp);
}
```

### 6.3 å†…å­˜ç¡¬ä»¶ä¿¡æ¯


**è¯¦ç»†å†…å­˜ä¿¡æ¯è·å–ï¼š**
```c
typedef struct {
    long total_kb;      // æ€»å†…å­˜(KB)
    long free_kb;       // ç©ºé—²å†…å­˜(KB)
    long available_kb;  // å¯ç”¨å†…å­˜(KB)
    long buffers_kb;    // ç¼“å†²åŒº(KB)
    long cached_kb;     // ç¼“å­˜(KB)
    long swap_total_kb; // äº¤æ¢ç©ºé—´æ€»é‡(KB)
    long swap_free_kb;  // äº¤æ¢ç©ºé—´å¯ç”¨(KB)
} memory_info_t;

void get_detailed_memory_info() {
    FILE *fp;
    char line[256];
    memory_info_t mem = {0};
    
    fp = fopen("/proc/meminfo", "r");
    if (fp == NULL) {
        perror("æ— æ³•è¯»å–å†…å­˜ä¿¡æ¯");
        return;
    }
    
    while (fgets(line, sizeof(line), fp)) {
        if (strstr(line, "MemTotal:")) {
            sscanf(line, "MemTotal: %ld kB", &mem.total_kb);
        } else if (strstr(line, "MemFree:")) {
            sscanf(line, "MemFree: %ld kB", &mem.free_kb);
        } else if (strstr(line, "MemAvailable:")) {
            sscanf(line, "MemAvailable: %ld kB", &mem.available_kb);
        } else if (strstr(line, "Buffers:")) {
            sscanf(line, "Buffers: %ld kB", &mem.buffers_kb);
        } else if (strstr(line, "Cached:")) {
            sscanf(line, "Cached: %ld kB", &mem.cached_kb);
        } else if (strstr(line, "SwapTotal:")) {
            sscanf(line, "SwapTotal: %ld kB", &mem.swap_total_kb);
        } else if (strstr(line, "SwapFree:")) {
            sscanf(line, "SwapFree: %ld kB", &mem.swap_free_kb);
        }
    }
    
    fclose(fp);
    
    printf("\nå†…å­˜ç¡¬ä»¶ä¿¡æ¯\n");
    printf("=============\n");
    printf("ç‰©ç†å†…å­˜æ€»é‡: %.2f GB\n", mem.total_kb / 1024.0 / 1024.0);
    printf("ç‰©ç†å†…å­˜ç©ºé—²: %.2f GB\n", mem.free_kb / 1024.0 / 1024.0);
    printf("ç‰©ç†å†…å­˜å¯ç”¨: %.2f GB\n", mem.available_kb / 1024.0 / 1024.0);
    printf("ç¼“å†²åŒºå¤§å°:   %.2f GB\n", mem.buffers_kb / 1024.0 / 1024.0);
    printf("ç¼“å­˜å¤§å°:     %.2f GB\n", mem.cached_kb / 1024.0 / 1024.0);
    
    if (mem.swap_total_kb > 0) {
        printf("äº¤æ¢ç©ºé—´æ€»é‡: %.2f GB\n", mem.swap_total_kb / 1024.0 / 1024.0);
        printf("äº¤æ¢ç©ºé—´å¯ç”¨: %.2f GB\n", mem.swap_free_kb / 1024.0 / 1024.0);
        printf("äº¤æ¢ç©ºé—´ä½¿ç”¨: %.1f%%\n", 
               (mem.swap_total_kb - mem.swap_free_kb) * 100.0 / mem.swap_total_kb);
    } else {
        printf("äº¤æ¢ç©ºé—´:     æœªé…ç½®\n");
    }
    
    // å†…å­˜ä½¿ç”¨åˆ†æ
    long used_kb = mem.total_kb - mem.available_kb;
    printf("\nå†…å­˜ä½¿ç”¨åˆ†æ\n");
    printf("å·²ç”¨å†…å­˜:     %.2f GB (%.1f%%)\n", 
           used_kb / 1024.0 / 1024.0, used_kb * 100.0 / mem.total_kb);
    printf("ç¼“å­˜å ç”¨:     %.2f GB (%.1f%%)\n", 
           (mem.buffers_kb + mem.cached_kb) / 1024.0 / 1024.0,
           (mem.buffers_kb + mem.cached_kb) * 100.0 / mem.total_kb);
}
```

### 6.4 ç£ç›˜è®¾å¤‡ä¿¡æ¯


**è·å–ç£ç›˜è®¾å¤‡ä¿¡æ¯ï¼š**
```c
void get_disk_info() {
    FILE *fp;
    char line[256];
    
    printf("\nç£ç›˜è®¾å¤‡ä¿¡æ¯\n");
    printf("=============\n");
    
    // è¯»å–åˆ†åŒºä¿¡æ¯
    fp = fopen("/proc/partitions", "r");
    if (fp == NULL) {
        perror("æ— æ³•è¯»å–åˆ†åŒºä¿¡æ¯");
        return;
    }
    
    // è·³è¿‡å¤´éƒ¨ä¸¤è¡Œ
    fgets(line, sizeof(line), fp);
    fgets(line, sizeof(line), fp);
    
    printf("%-10s %-10s %-15s %s\n", "ä¸»è®¾å¤‡å·", "æ¬¡è®¾å¤‡å·", "å¤§å°(KB)", "è®¾å¤‡å");
    printf("%-10s %-10s %-15s %s\n", "--------", "--------", "-------", "------");
    
    while (fgets(line, sizeof(line), fp)) {
        int major, minor;
        long blocks;
        char name[32];
        
        if (sscanf(line, "%d %d %ld %s", &major, &minor, &blocks, name) == 4) {
            printf("%-10d %-10d %-15ld %s\n", major, minor, blocks, name);
        }
    }
    
    fclose(fp);
}
```

---

## 7. ğŸ“ˆ ç³»ç»Ÿè´Ÿè½½ä¸æ€§èƒ½æŒ‡æ ‡è¯»å–


### 7.1 ç³»ç»Ÿè´Ÿè½½çš„ç†è§£


**ç³»ç»Ÿè´Ÿè½½**è¡¨ç¤ºç³»ç»Ÿåœ¨ç‰¹å®šæ—¶é—´å†…ç­‰å¾…å¤„ç†çš„ä»»åŠ¡æ•°é‡ã€‚ç†è§£è´Ÿè½½æœ‰åŠ©äºè¯„ä¼°ç³»ç»Ÿæ€§èƒ½çŠ¶æ€ã€‚

```
è´Ÿè½½è®¡ç®—åŸç†ï¼š
è´Ÿè½½ = (æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°) + (ç­‰å¾…I/Oçš„è¿›ç¨‹æ•°) + (ç­‰å¾…CPUçš„è¿›ç¨‹æ•°)

æ—¶é—´ç»´åº¦ï¼š
â€¢ 1åˆ†é’Ÿå¹³å‡è´Ÿè½½ï¼šçŸ­æœŸè´Ÿè½½è¶‹åŠ¿
â€¢ 5åˆ†é’Ÿå¹³å‡è´Ÿè½½ï¼šä¸­æœŸè´Ÿè½½è¶‹åŠ¿  
â€¢ 15åˆ†é’Ÿå¹³å‡è´Ÿè½½ï¼šé•¿æœŸè´Ÿè½½è¶‹åŠ¿
```

### 7.2 ç³»ç»Ÿè´Ÿè½½è¯»å–


```c
#include <stdio.h>
#include <stdlib.h>

typedef struct {
    double load_1min;   // 1åˆ†é’Ÿå¹³å‡è´Ÿè½½
    double load_5min;   // 5åˆ†é’Ÿå¹³å‡è´Ÿè½½
    double load_15min;  // 15åˆ†é’Ÿå¹³å‡è´Ÿè½½
    int running_procs;  // å½“å‰è¿è¡Œè¿›ç¨‹æ•°
    int total_procs;    // æ€»è¿›ç¨‹æ•°
    int last_pid;       // æœ€ååˆ›å»ºçš„è¿›ç¨‹PID
} load_info_t;

void get_system_load() {
    FILE *fp;
    load_info_t load = {0};
    
    // è¯»å–è´Ÿè½½ä¿¡æ¯
    fp = fopen("/proc/loadavg", "r");
    if (fp == NULL) {
        perror("æ— æ³•è¯»å–ç³»ç»Ÿè´Ÿè½½");
        return;
    }
    
    fscanf(fp, "%lf %lf %lf %d/%d %d", 
           &load.load_1min, &load.load_5min, &load.load_15min,
           &load.running_procs, &load.total_procs, &load.last_pid);
    
    fclose(fp);
    
    printf("ç³»ç»Ÿè´Ÿè½½ä¿¡æ¯\n");
    printf("=============\n");
    printf("1åˆ†é’Ÿå¹³å‡è´Ÿè½½:   %.2f\n", load.load_1min);
    printf("5åˆ†é’Ÿå¹³å‡è´Ÿè½½:   %.2f\n", load.load_5min);
    printf("15åˆ†é’Ÿå¹³å‡è´Ÿè½½:  %.2f\n", load.load_15min);
    printf("å½“å‰è¿è¡Œè¿›ç¨‹:    %d\n", load.running_procs);
    printf("æ€»è¿›ç¨‹æ•°:        %d\n", load.total_procs);
    printf("æœ€åè¿›ç¨‹PID:     %d\n", load.last_pid);
    
    // è´Ÿè½½çŠ¶æ€åˆ†æ
    printf("\nè´Ÿè½½çŠ¶æ€åˆ†æ\n");
    printf("=============\n");
    
    // è·å–CPUæ ¸å¿ƒæ•°æ¥åˆ¤æ–­è´Ÿè½½æ°´å¹³
    long cpu_count = sysconf(_SC_NPROCESSORS_ONLN);
    if (cpu_count > 0) {
        double load_per_cpu = load.load_1min / cpu_count;
        printf("æ¯CPUè´Ÿè½½:       %.2f\n", load_per_cpu);
        
        if (load_per_cpu < 0.7) {
            printf("è´Ÿè½½çŠ¶æ€:        è‰¯å¥½ (ç³»ç»Ÿç©ºé—²)\n");
        } else if (load_per_cpu < 1.0) {
            printf("è´Ÿè½½çŠ¶æ€:        æ­£å¸¸ (ç³»ç»Ÿç¹å¿™)\n");
        } else if (load_per_cpu < 2.0) {
            printf("è´Ÿè½½çŠ¶æ€:        è¾ƒé«˜ (éœ€è¦å…³æ³¨)\n");
        } else {
            printf("è´Ÿè½½çŠ¶æ€:        è¿‡è½½ (éœ€è¦ä¼˜åŒ–)\n");
        }
    }
    
    // è´Ÿè½½è¶‹åŠ¿åˆ†æ
    if (load.load_1min > load.load_5min && load.load_5min > load.load_15min) {
        printf("è´Ÿè½½è¶‹åŠ¿:        ä¸Šå‡\n");
    } else if (load.load_1min < load.load_5min && load.load_5min < load.load_15min) {
        printf("è´Ÿè½½è¶‹åŠ¿:        ä¸‹é™\n");
    } else {
        printf("è´Ÿè½½è¶‹åŠ¿:        ç¨³å®š\n");
    }
}
```

### 7.3 CPUä½¿ç”¨ç‡ç»Ÿè®¡


```c
typedef struct {
    unsigned long user;     // ç”¨æˆ·æ€æ—¶é—´
    unsigned long nice;     // ä½ä¼˜å…ˆçº§ç”¨æˆ·æ€æ—¶é—´
    unsigned long system;   // å†…æ ¸æ€æ—¶é—´
    unsigned long idle;     // ç©ºé—²æ—¶é—´
    unsigned long iowait;   // ç­‰å¾…I/Oæ—¶é—´
    unsigned long irq;      // ç¡¬ä¸­æ–­æ—¶é—´
    unsigned long softirq;  // è½¯ä¸­æ–­æ—¶é—´
    unsigned long steal;    // è™šæ‹ŸåŒ–ç¯å¢ƒè¢«å·æ—¶é—´
    unsigned long guest;    // è¿è¡Œè™šæ‹Ÿæœºæ—¶é—´
    unsigned long guest_nice; // è¿è¡Œä½ä¼˜å…ˆçº§è™šæ‹Ÿæœºæ—¶é—´
} cpu_times_t;

void get_cpu_usage() {
    FILE *fp;
    char line[256];
    cpu_times_t cpu_times = {0};
    
    fp = fopen("/proc/stat", "r");
    if (fp == NULL) {
        perror("æ— æ³•è¯»å–CPUç»Ÿè®¡");
        return;
    }
    
    // è¯»å–ç¬¬ä¸€è¡Œ CPU æ€»ä½“ç»Ÿè®¡
    if (fgets(line, sizeof(line), fp)) {
        sscanf(line, "cpu %lu %lu %lu %lu %lu %lu %lu %lu %lu %lu",
               &cpu_times.user, &cpu_times.nice, &cpu_times.system,
               &cpu_times.idle, &cpu_times.iowait, &cpu_times.irq,
               &cpu_times.softirq, &cpu_times.steal, 
               &cpu_times.guest, &cpu_times.guest_nice);
    }
    
    fclose(fp);
    
    // è®¡ç®—æ€»æ—¶é—´å’Œå„éƒ¨åˆ†å æ¯”
    unsigned long total = cpu_times.user + cpu_times.nice + cpu_times.system +
                         cpu_times.idle + cpu_times.iowait + cpu_times.irq +
                         cpu_times.softirq + cpu_times.steal;
    
    printf("\nCPUä½¿ç”¨ç‡ç»Ÿè®¡\n");
    printf("==============\n");
    printf("ç”¨æˆ·æ€:          %.1f%%\n", cpu_times.user * 100.0 / total);
    printf("ç³»ç»Ÿæ€:          %.1f%%\n", cpu_times.system * 100.0 / total);
    printf("ç©ºé—²:            %.1f%%\n", cpu_times.idle * 100.0 / total);
    printf("I/Oç­‰å¾…:         %.1f%%\n", cpu_times.iowait * 100.0 / total);
    printf("ä¸­æ–­å¤„ç†:        %.1f%%\n", 
           (cpu_times.irq + cpu_times.softirq) * 100.0 / total);
    
    double cpu_usage = (total - cpu_times.idle) * 100.0 / total;
    printf("æ€»CPUä½¿ç”¨ç‡:     %.1f%%\n", cpu_usage);
}
```

### 7.4 æ€§èƒ½ç›‘æ§ç»¼åˆç¤ºä¾‹


```c
// ç»¼åˆæ€§èƒ½ç›‘æ§å‡½æ•°
void performance_monitor() {
    printf("===============================\n");
    printf("     ç³»ç»Ÿæ€§èƒ½ç›‘æ§æŠ¥å‘Š\n");
    printf("===============================\n");
    
    // ç³»ç»ŸåŸºæœ¬ä¿¡æ¯
    struct utsname sys_info;
    if (uname(&sys_info) == 0) {
        printf("ç³»ç»Ÿ: %s %s\n", sys_info.sysname, sys_info.release);
        printf("ä¸»æœº: %s\n", sys_info.nodename);
    }
    
    // ç³»ç»Ÿè´Ÿè½½
    get_system_load();
    
    // CPUä½¿ç”¨ç‡
    get_cpu_usage();
    
    // å†…å­˜ä½¿ç”¨æƒ…å†µ
    struct sysinfo si;
    if (sysinfo(&si) == 0) {
        printf("\nå†…å­˜ä½¿ç”¨æƒ…å†µ\n");
        printf("=============\n");
        printf("å†…å­˜ä½¿ç”¨ç‡:      %.1f%%\n", 
               (si.totalram - si.freeram) * 100.0 / si.totalram);
        printf("äº¤æ¢ä½¿ç”¨ç‡:      %.1f%%\n", 
               (si.totalswap - si.freeswap) * 100.0 / si.totalswap);
    }
    
    printf("\n===============================\n");
}
```

---

## 8. ğŸ“Š è¿›ç¨‹èµ„æºä½¿ç”¨getrusage()


### 8.1 getrusage()å‡½æ•°æ¦‚è¿°


**getrusage()** ç”¨äºè·å–è¿›ç¨‹æˆ–å­è¿›ç¨‹çš„èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼Œå°±åƒç»™è¿›ç¨‹åš"ä½“æ£€"ï¼Œäº†è§£å®ƒæ¶ˆè€—äº†å¤šå°‘CPUæ—¶é—´ã€å†…å­˜ç­‰èµ„æºã€‚

```c
#include <sys/resource.h>

int getrusage(int who, struct rusage *usage);
```

**å‚æ•°è¯´æ˜ï¼š**
- **who**ï¼šæŒ‡å®šè¦æŸ¥è¯¢çš„å¯¹è±¡
  - `RUSAGE_SELF`ï¼šå½“å‰è¿›ç¨‹
  - `RUSAGE_CHILDREN`ï¼šå·²ç»ˆæ­¢çš„å­è¿›ç¨‹
  - `RUSAGE_THREAD`ï¼šå½“å‰çº¿ç¨‹(Linuxç‰¹æœ‰)
- **usage**ï¼šæŒ‡å‘ `rusage` ç»“æ„ä½“çš„æŒ‡é’ˆ

### 8.2 rusageç»“æ„ä½“è¯¦è§£


```c
struct rusage {
    struct timeval ru_utime;    // ç”¨æˆ·æ€CPUæ—¶é—´
    struct timeval ru_stime;    // å†…æ ¸æ€CPUæ—¶é—´
    long ru_maxrss;             // æœ€å¤§å¸¸é©»å†…å­˜(KB)
    long ru_ixrss;              // ç§¯åˆ†å…±äº«å†…å­˜å¤§å°
    long ru_idrss;              // ç§¯åˆ†éå…±äº«æ•°æ®å†…å­˜å¤§å°
    long ru_isrss;              // ç§¯åˆ†éå…±äº«æ ˆå†…å­˜å¤§å°
    long ru_minflt;             // æ¬¡ç¼ºé¡µé”™è¯¯æ¬¡æ•°
    long ru_majflt;             // ä¸»ç¼ºé¡µé”™è¯¯æ¬¡æ•°
    long ru_nswap;              // äº¤æ¢æ¬¡æ•°
    long ru_inblock;            // å—è¾“å…¥æ“ä½œæ¬¡æ•°
    long ru_oublock;            // å—è¾“å‡ºæ“ä½œæ¬¡æ•°
    long ru_msgsnd;             // å‘é€æ¶ˆæ¯æ¬¡æ•°
    long ru_msgrcv;             // æ¥æ”¶æ¶ˆæ¯æ¬¡æ•°
    long ru_nsignals;           // æ”¶åˆ°ä¿¡å·æ¬¡æ•°
    long ru_nvcsw;              // ä¸»åŠ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°
    long ru_nivcsw;             // è¢«åŠ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°
};
```

**é‡è¦å­—æ®µè¯´æ˜ï¼š**
```
ru_utimeï¼š    ç¨‹åºåœ¨ç”¨æˆ·æ€æ‰§è¡Œçš„æ—¶é—´
ru_stimeï¼š    ç¨‹åºåœ¨å†…æ ¸æ€æ‰§è¡Œçš„æ—¶é—´
ru_maxrssï¼š   ç¨‹åºä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡
ru_minfltï¼š   æ¬¡ç¼ºé¡µé”™è¯¯(ä¸éœ€è¦ç£ç›˜I/O)
ru_majfltï¼š   ä¸»ç¼ºé¡µé”™è¯¯(éœ€è¦ç£ç›˜I/O)
ru_nvcswï¼š    è¿›ç¨‹ä¸»åŠ¨è®©å‡ºCPUçš„æ¬¡æ•°
ru_nivcswï¼š   è¿›ç¨‹è¢«å¼ºåˆ¶åˆ‡æ¢çš„æ¬¡æ•°
```

### 8.3 åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹


```c
#include <stdio.h>
#include <sys/resource.h>
#include <unistd.h>
#include <stdlib.h>

void print_resource_usage(const char *label) {
    struct rusage usage;
    
    if (getrusage(RUSAGE_SELF, &usage) == -1) {
        perror("getrusage failed");
        return;
    }
    
    printf("\n%s èµ„æºä½¿ç”¨æƒ…å†µ\n", label);
    printf("========================\n");
    
    // CPUæ—¶é—´
    double user_time = usage.ru_utime.tv_sec + usage.ru_utime.tv_usec / 1000000.0;
    double sys_time = usage.ru_stime.tv_sec + usage.ru_stime.tv_usec / 1000000.0;
    double total_time = user_time + sys_time;
    
    printf("ç”¨æˆ·æ€CPUæ—¶é—´:    %.3f ç§’\n", user_time);
    printf("å†…æ ¸æ€CPUæ—¶é—´:    %.3f ç§’\n", sys_time);
    printf("æ€»CPUæ—¶é—´:       %.3f ç§’\n", total_time);
    
    // å†…å­˜ä½¿ç”¨
    printf("æœ€å¤§å†…å­˜ä½¿ç”¨:     %ld KB (%.2f MB)\n", 
           usage.ru_maxrss, usage.ru_maxrss / 1024.0);
    
    // ç¼ºé¡µé”™è¯¯
    printf("æ¬¡ç¼ºé¡µé”™è¯¯:       %ld æ¬¡\n", usage.ru_minflt);
    printf("ä¸»ç¼ºé¡µé”™è¯¯:       %ld æ¬¡\n", usage.ru_majflt);
    
    // I/Oæ“ä½œ
    printf("å—è¯»å–æ“ä½œ:       %ld æ¬¡\n", usage.ru_inblock);
    printf("å—å†™å…¥æ“ä½œ:       %ld æ¬¡\n", usage.ru_oublock);
    
    // ä¸Šä¸‹æ–‡åˆ‡æ¢
    printf("ä¸»åŠ¨ä¸Šä¸‹æ–‡åˆ‡æ¢:   %ld æ¬¡\n", usage.ru_nvcsw);
    printf("è¢«åŠ¨ä¸Šä¸‹æ–‡åˆ‡æ¢:   %ld æ¬¡\n", usage.ru_nivcsw);
}

int main() {
    printf("ç¨‹åºå¼€å§‹æ‰§è¡Œ...\n");
    print_resource_usage("å¯åŠ¨æ—¶");
    
    // æ¨¡æ‹Ÿä¸€äº›CPUå¯†é›†å‹å·¥ä½œ
    printf("\næ‰§è¡ŒCPUå¯†é›†å‹ä»»åŠ¡...\n");
    long sum = 0;
    for (int i = 0; i < 100000000; i++) {
        sum += i;
    }
    printf("è®¡ç®—ç»“æœ: %ld\n", sum);
    
    print_resource_usage("CPUå¯†é›†å‹ä»»åŠ¡å");
    
    // æ¨¡æ‹Ÿå†…å­˜åˆ†é…
    printf("\næ‰§è¡Œå†…å­˜åˆ†é…ä»»åŠ¡...\n");
    char *buffer = malloc(50 * 1024 * 1024); // åˆ†é…50MB
    if (buffer) {
        // å†™å…¥æ•°æ®è§¦å‘å®é™…å†…å­˜åˆ†é…
        for (int i = 0; i < 50 * 1024 * 1024; i += 4096) {
            buffer[i] = (char)i;
        }
        printf("åˆ†é…å¹¶ä½¿ç”¨äº†50MBå†…å­˜\n");
        
        print_resource_usage("å†…å­˜åˆ†é…å");
        free(buffer);
    }
    
    return 0;
}
```

### 8.4 æ€§èƒ½åˆ†æå·¥å…·å‡½æ•°


```c
// è®¡ç®—ä¸¤æ¬¡æµ‹é‡ä¹‹é—´çš„èµ„æºä½¿ç”¨å·®å€¼
void calculate_usage_diff(struct rusage *start, struct rusage *end, 
                         const char *operation) {
    printf("\n%s èµ„æºæ¶ˆè€—ç»Ÿè®¡\n", operation);
    printf("========================\n");
    
    // CPUæ—¶é—´å·®å€¼
    double start_user = start->ru_utime.tv_sec + start->ru_utime.tv_usec / 1000000.0;
    double end_user = end->ru_utime.tv_sec + end->ru_utime.tv_usec / 1000000.0;
    double start_sys = start->ru_stime.tv_sec + start->ru_stime.tv_usec / 1000000.0;
    double end_sys = end->ru_stime.tv_sec + end->ru_stime.tv_usec / 1000000.0;
    
    printf("ç”¨æˆ·æ€CPUæ—¶é—´:    %.3f ç§’\n", end_user - start_user);
    printf("å†…æ ¸æ€CPUæ—¶é—´:    %.3f ç§’\n", end_sys - start_sys);
    printf("æ€»CPUæ—¶é—´:       %.3f ç§’\n", 
           (end_user + end_sys) - (start_user + start_sys));
    
    // ç¼ºé¡µé”™è¯¯å·®å€¼
    printf("æ¬¡ç¼ºé¡µé”™è¯¯:       %ld æ¬¡\n", end->ru_minflt - start->ru_minflt);
    printf("ä¸»ç¼ºé¡µé”™è¯¯:       %ld æ¬¡\n", end->ru_majflt - start->ru_majflt);
    
    // ä¸Šä¸‹æ–‡åˆ‡æ¢å·®å€¼
    printf("ä¸»åŠ¨ä¸Šä¸‹æ–‡åˆ‡æ¢:   %ld æ¬¡\n", end->ru_nvcsw - start->ru_nvcsw);
    printf("è¢«åŠ¨ä¸Šä¸‹æ–‡åˆ‡æ¢:   %ld æ¬¡\n", end->ru_nivcsw - start->ru_nivcsw);
}

// æ€§èƒ½åŸºå‡†æµ‹è¯•æ¡†æ¶
void benchmark_function(void (*func)(void), const char *func_name) {
    struct rusage start, end;
    
    printf("\næ­£åœ¨æµ‹è¯•å‡½æ•°: %s\n", func_name);
    printf("==============================\n");
    
    // è®°å½•å¼€å§‹çŠ¶æ€
    getrusage(RUSAGE_SELF, &start);
    
    // æ‰§è¡Œè¢«æµ‹è¯•çš„å‡½æ•°
    func();
    
    // è®°å½•ç»“æŸçŠ¶æ€
    getrusage(RUSAGE_SELF, &end);
    
    // è®¡ç®—å¹¶æ˜¾ç¤ºèµ„æºæ¶ˆè€—
    calculate_usage_diff(&start, &end, func_name);
}
```

### 8.5 å®é™…åº”ç”¨ï¼šæ€§èƒ½ç›‘æ§å™¨


```c
// ç®€å•çš„æ€§èƒ½ç›‘æ§å™¨
typedef struct {
    struct rusage last_usage;
    time_t last_time;
    int initialized;
} performance_monitor_t;

performance_monitor_t perf_monitor = {0};

void init_performance_monitor() {
    getrusage(RUSAGE_SELF, &perf_monitor.last_usage);
    perf_monitor.last_time = time(NULL);
    perf_monitor.initialized = 1;
    printf("æ€§èƒ½ç›‘æ§å™¨å·²åˆå§‹åŒ–\n");
}

void show_performance_delta() {
    if (!perf_monitor.initialized) {
        printf("æ€§èƒ½ç›‘æ§å™¨æœªåˆå§‹åŒ–\n");
        return;
    }
    
    struct rusage current_usage;
    time_t current_time = time(NULL);
    
    getrusage(RUSAGE_SELF, &current_usage);
    
    double time_elapsed = difftime(current_time, perf_monitor.last_time);
    
    printf("\næ€§èƒ½ç›‘æ§æŠ¥å‘Š (è¿‡å» %.0f ç§’)\n", time_elapsed);
    printf("============================\n");
    
    calculate_usage_diff(&perf_monitor.last_usage, &current_usage, 
                        "æ—¶é—´é—´éš”å†…");
    
    // æ›´æ–°ä¸Šæ¬¡è®°å½•
    perf_monitor.last_usage = current_usage;
    perf_monitor.last_time = current_time;
}
```

---

## 9. âš™ï¸ ç³»ç»Ÿé™åˆ¶ä¸é…ç½®å‚æ•°


### 9.1 ç³»ç»Ÿé™åˆ¶æ¦‚è¿°


Linuxç³»ç»Ÿä¸ºäº†ä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§å’Œå…¬å¹³æ€§ï¼Œå¯¹å„ç§èµ„æºçš„ä½¿ç”¨éƒ½è®¾å®šäº†é™åˆ¶ã€‚è¿™äº›é™åˆ¶åˆ†ä¸ºï¼š

```
ç³»ç»Ÿé™åˆ¶çš„å±‚æ¬¡ï¼š
â”œâ”€â”€ ç¡¬é™åˆ¶ (Hard Limit)
â”‚   â”œâ”€â”€ å†…æ ¸ç¼–è¯‘æ—¶è®¾å®šçš„ç»å¯¹ä¸Šé™
â”‚   â””â”€â”€ åªæœ‰rootç”¨æˆ·æ‰èƒ½ä¿®æ”¹
â”œâ”€â”€ è½¯é™åˆ¶ (Soft Limit)  
â”‚   â”œâ”€â”€ ç”¨æˆ·è¿›ç¨‹çš„å®é™…é™åˆ¶
â”‚   â””â”€â”€ å¯ä»¥åœ¨ç¡¬é™åˆ¶èŒƒå›´å†…è°ƒæ•´
â””â”€â”€ é»˜è®¤é™åˆ¶
    â”œâ”€â”€ ç³»ç»Ÿå¯åŠ¨æ—¶çš„åˆå§‹å€¼
    â””â”€â”€ å¯é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹
```

### 9.2 èµ„æºé™åˆ¶ç±»å‹


| èµ„æºç±»å‹ | **é™åˆ¶é¡¹** | **è¯´æ˜** | **å½±å“** |
|---------|-----------|---------|---------|
| ğŸ• **æ—¶é—´é™åˆ¶** | `RLIMIT_CPU` | `CPUæ—¶é—´é™åˆ¶(ç§’)` | `é˜²æ­¢è¿›ç¨‹é•¿æ—¶é—´å ç”¨CPU` |
| ğŸ’¾ **å†…å­˜é™åˆ¶** | `RLIMIT_AS`<br>`RLIMIT_DATA`<br>`RLIMIT_STACK` | `è™šæ‹Ÿå†…å­˜æ€»é‡`<br>`æ•°æ®æ®µå¤§å°`<br>`æ ˆå¤§å°` | `é˜²æ­¢å†…å­˜è€—å°½` |
| ğŸ“ **æ–‡ä»¶é™åˆ¶** | `RLIMIT_FSIZE`<br>`RLIMIT_NOFILE` | `æ–‡ä»¶å¤§å°é™åˆ¶`<br>`æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶` | `é˜²æ­¢ç£ç›˜ç©ºé—´è€—å°½` |
| ğŸ”¢ **è¿›ç¨‹é™åˆ¶** | `RLIMIT_NPROC` | `ç”¨æˆ·è¿›ç¨‹æ•°é™åˆ¶` | `é˜²æ­¢è¿›ç¨‹è¿‡å¤šå½±å“ç³»ç»Ÿ` |
| ğŸ”’ **å…¶ä»–é™åˆ¶** | `RLIMIT_CORE`<br>`RLIMIT_MEMLOCK` | `æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶å¤§å°`<br>`é”å®šå†…å­˜å¤§å°` | `ç³»ç»Ÿç¨³å®šæ€§ä¿æŠ¤` |

### 9.3 è·å–å’Œè®¾ç½®èµ„æºé™åˆ¶


```c
#include <stdio.h>
#include <sys/resource.h>
#include <stdlib.h>
#include <string.h>

// æ‰“å°èµ„æºé™åˆ¶å€¼
void print_limit(int resource, const char *name) {
    struct rlimit limit;
    
    if (getrlimit(resource, &limit) == -1) {
        perror("getrlimit");
        return;
    }
    
    printf("%-20s ", name);
    
    // è½¯é™åˆ¶
    if (limit.rlim_cur == RLIM_INFINITY) {
        printf("è½¯é™åˆ¶: æ— é™åˆ¶     ");
    } else {
        printf("è½¯é™åˆ¶: %-10ld ", limit.rlim_cur);
    }
    
    // ç¡¬é™åˆ¶
    if (limit.rlim_max == RLIM_INFINITY) {
        printf("ç¡¬é™åˆ¶: æ— é™åˆ¶\n");
    } else {
        printf("ç¡¬é™åˆ¶: %ld\n", limit.rlim_max);
    }
}

void show_all_limits() {
    printf("ç³»ç»Ÿèµ„æºé™åˆ¶\n");
    printf("===============================================\n");
    printf("%-20s %-18s %s\n", "èµ„æºç±»å‹", "è½¯é™åˆ¶", "ç¡¬é™åˆ¶");
    printf("===============================================\n");
    
    print_limit(RLIMIT_CPU, "CPUæ—¶é—´(ç§’)");
    print_limit(RLIMIT_FSIZE, "æ–‡ä»¶å¤§å°(å­—èŠ‚)");
    print_limit(RLIMIT_DATA, "æ•°æ®æ®µ(å­—èŠ‚)");
    print_limit(RLIMIT_STACK, "æ ˆå¤§å°(å­—èŠ‚)");
    print_limit(RLIMIT_CORE, "æ ¸å¿ƒè½¬å‚¨(å­—èŠ‚)");
    print_limit(RLIMIT_RSS, "å¸¸é©»å†…å­˜(å­—èŠ‚)");
    print_limit(RLIMIT_NPROC, "è¿›ç¨‹æ•°é‡");
    print_limit(RLIMIT_NOFILE, "æ‰“å¼€æ–‡ä»¶æ•°");
    print_limit(RLIMIT_MEMLOCK, "é”å®šå†…å­˜(å­—èŠ‚)");
    print_limit(RLIMIT_AS, "è™šæ‹Ÿå†…å­˜(å­—èŠ‚)");
}

// è®¾ç½®èµ„æºé™åˆ¶ç¤ºä¾‹
int set_file_limit(long max_files) {
    struct rlimit limit;
    
    // è·å–å½“å‰é™åˆ¶
    if (getrlimit(RLIMIT_NOFILE, &limit) == -1) {
        perror("getrlimit");
        return -1;
    }
    
    printf("å½“å‰æ–‡ä»¶æè¿°ç¬¦é™åˆ¶: è½¯é™åˆ¶=%ld, ç¡¬é™åˆ¶=%ld\n", 
           limit.rlim_cur, limit.rlim_max);
    
    // è®¾ç½®æ–°çš„è½¯é™åˆ¶
    if (max_files <= limit.rlim_max) {
        limit.rlim_cur = max_files;
        
        if (setrlimit(RLIMIT_NOFILE, &limit) == -1) {
            perror("setrlimit");
            return -1;
        }
        
        printf("æˆåŠŸè®¾ç½®æ–‡ä»¶æè¿°ç¬¦è½¯é™åˆ¶ä¸º: %ld\n", max_files);
        return 0;
    } else {
        printf("é”™è¯¯: è¯·æ±‚çš„é™åˆ¶(%ld)è¶…è¿‡ç¡¬é™åˆ¶(%ld)\n", 
               max_files, limit.rlim_max);
        return -1;
    }
}
```

### 9.4 ä¼˜å…ˆçº§å’Œè°ƒåº¦ç­–ç•¥


```c
#include <sched.h>

// è·å–å’Œè®¾ç½®è¿›ç¨‹ä¼˜å…ˆçº§
void manage_process_priority() {
    int current_priority;
    int new_priority;
    
    // è·å–å½“å‰è¿›ç¨‹çš„niceå€¼
    current_priority = getpriority(PRIO_PROCESS, 0);
    printf("å½“å‰è¿›ç¨‹ä¼˜å…ˆçº§(niceå€¼): %d\n", current_priority);
    
    // è®¾ç½®æ–°çš„ä¼˜å…ˆçº§(éœ€è¦é€‚å½“æƒé™)
    new_priority = 5; // è¾ƒä½ä¼˜å…ˆçº§
    if (setpriority(PRIO_PROCESS, 0, new_priority) == 0) {
        printf("æˆåŠŸè®¾ç½®è¿›ç¨‹ä¼˜å…ˆçº§ä¸º: %d\n", new_priority);
    } else {
        perror("è®¾ç½®ä¼˜å…ˆçº§å¤±è´¥");
    }
    
    // è·å–è°ƒåº¦ç­–ç•¥
    int policy = sched_getscheduler(0);
    printf("å½“å‰è°ƒåº¦ç­–ç•¥: ");
    switch (policy) {
        case SCHED_OTHER:
            printf("SCHED_OTHER (æ™®é€šè°ƒåº¦)\n");
            break;
        case SCHED_FIFO:
            printf("SCHED_FIFO (å®æ—¶å…ˆè¿›å…ˆå‡º)\n");
            break;
        case SCHED_RR:
            printf("SCHED_RR (å®æ—¶è½®è½¬)\n");
            break;
        default:
            printf("æœªçŸ¥è°ƒåº¦ç­–ç•¥ (%d)\n", policy);
    }
}

// ç³»ç»Ÿé…ç½®å‚æ•°æŸ¥è¯¢
void show_system_config_details() {
    printf("\nè¯¦ç»†ç³»ç»Ÿé…ç½®å‚æ•°\n");
    printf("===================\n");
    
    // æ—¶é—´ç›¸å…³é…ç½®
    printf("æ—¶é—´é…ç½®:\n");
    printf("  æ—¶é’Ÿé¢‘ç‡:         %ld Hz\n", sysconf(_SC_CLK_TCK));
    printf("  æ—¶é’Ÿåˆ†è¾¨ç‡:       %.9f ç§’\n", 1.0 / sysconf(_SC_CLK_TCK));
    
    // å†…å­˜ç›¸å…³é…ç½®
    printf("\nå†…å­˜é…ç½®:\n");
    long page_size = sysconf(_SC_PAGE_SIZE);
    long phys_pages = sysconf(_SC_PHYS_PAGES);
    long avail_pages = sysconf(_SC_AVPHYS_PAGES);
    
    printf("  é¡µé¢å¤§å°:         %ld å­—èŠ‚\n", page_size);
    printf("  ç‰©ç†é¡µé¢æ€»æ•°:     %ld é¡µ\n", phys_pages);
    printf("  å¯ç”¨é¡µé¢æ•°:       %ld é¡µ\n", avail_pages);
    
    if (page_size > 0 && phys_pages > 0) {
        printf("  ç‰©ç†å†…å­˜æ€»é‡:     %.2f GB\n", 
               (phys_pages * page_size) / (1024.0 * 1024.0 * 1024.0));
        printf("  å¯ç”¨ç‰©ç†å†…å­˜:     %.2f GB\n", 
               (avail_pages * page_size) / (1024.0 * 1024.0 * 1024.0));
    }
    
    // å¤„ç†å™¨ç›¸å…³é…ç½®
    printf("\nå¤„ç†å™¨é…ç½®:\n");
    printf("  åœ¨çº¿CPUæ•°:        %ld ä¸ª\n", sysconf(_SC_NPROCESSORS_ONLN));
    printf("  å·²é…ç½®CPUæ•°:      %ld ä¸ª\n", sysconf(_SC_NPROCESSORS_CONF));
    
    // æ–‡ä»¶ç³»ç»Ÿé…ç½®
    printf("\næ–‡ä»¶ç³»ç»Ÿé…ç½®:\n");
    printf("  æœ€å¤§æ–‡ä»¶åé•¿åº¦:   %ld å­—ç¬¦\n", sysconf(_SC_NAME_MAX));
    printf("  æœ€å¤§è·¯å¾„é•¿åº¦:     %ld å­—ç¬¦\n", sysconf(_SC_PATH_MAX));
    printf("  ç®¡é“ç¼“å†²åŒºå¤§å°:   %ld å­—èŠ‚\n", sysconf(_SC_PIPE_BUF));
    
    // è¿›ç¨‹ç›¸å…³é…ç½®
    printf("\nè¿›ç¨‹é…ç½®:\n");
    printf("  æœ€å¤§å‚æ•°é•¿åº¦:     %ld å­—èŠ‚\n", sysconf(_SC_ARG_MAX));
    printf("  å­è¿›ç¨‹æœ€å¤§æ•°:     %ld ä¸ª\n", sysconf(_SC_CHILD_MAX));
    printf("  è¿›ç¨‹æœ€å¤§æ‰“å¼€æ–‡ä»¶: %ld ä¸ª\n", sysconf(_SC_OPEN_MAX));
}
```

### 9.5 å®é™…åº”ç”¨åœºæ™¯


**åœºæ™¯1ï¼šé«˜æ€§èƒ½æœåŠ¡å™¨é…ç½®**
```c
// ä¸ºé«˜æ€§èƒ½æœåŠ¡å™¨ä¼˜åŒ–èµ„æºé™åˆ¶
void optimize_for_high_performance() {
    struct rlimit limit;
    
    printf("æ­£åœ¨ä¼˜åŒ–é«˜æ€§èƒ½æœåŠ¡å™¨é…ç½®...\n");
    
    // å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
    getrlimit(RLIMIT_NOFILE, &limit);
    printf("å½“å‰æ–‡ä»¶æè¿°ç¬¦é™åˆ¶: %ld\n", limit.rlim_cur);
    
    if (limit.rlim_cur < 65536) {
        limit.rlim_cur = (limit.rlim_max > 65536) ? 65536 : limit.rlim_max;
        if (setrlimit(RLIMIT_NOFILE, &limit) == 0) {
            printf("å·²ä¼˜åŒ–æ–‡ä»¶æè¿°ç¬¦é™åˆ¶è‡³: %ld\n", limit.rlim_cur);
        }
    }
    
    // æ£€æŸ¥å¹¶å»ºè®®å†…å­˜é…ç½®
    long total_mem = sysconf(_SC_PHYS_PAGES) * sysconf(_SC_PAGE_SIZE);
    printf("ç‰©ç†å†…å­˜æ€»é‡: %.2f GB\n", total_mem / (1024.0 * 1024.0 * 1024.0));
    
    if (total_mem < 8LL * 1024 * 1024 * 1024) { // å°äº8GB
        printf("å»ºè®®: å†…å­˜è¾ƒå°‘ï¼Œè€ƒè™‘å¢åŠ è™šæ‹Ÿå†…å­˜\n");
    }
    
    // æ£€æŸ¥CPUæ ¸å¿ƒæ•°
    long cpu_count = sysconf(_SC_NPROCESSORS_ONLN);
    printf("CPUæ ¸å¿ƒæ•°: %ld\n", cpu_count);
    printf("å»ºè®®å·¥ä½œçº¿ç¨‹æ•°: %ld\n", cpu_count * 2);
}

// ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µå¹¶å‘Šè­¦
void resource_usage_monitor() {
    struct rlimit nofile_limit;
    struct rusage usage;
    
    // æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨æƒ…å†µ
    getrlimit(RLIMIT_NOFILE, &nofile_limit);
    
    // é€šè¿‡/proc/self/fdç›®å½•è®¡ç®—å½“å‰æ‰“å¼€çš„æ–‡ä»¶æ•°
    system("ls /proc/self/fd | wc -l > /tmp/fd_count");
    FILE *fp = fopen("/tmp/fd_count", "r");
    int current_fds = 0;
    if (fp) {
        fscanf(fp, "%d", &current_fds);
        fclose(fp);
        unlink("/tmp/fd_count");
    }
    
    double fd_usage_percent = (current_fds * 100.0) / nofile_limit.rlim_cur;
    
    printf("èµ„æºä½¿ç”¨ç›‘æ§\n");
    printf("=============\n");
    printf("æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨: %d/%ld (%.1f%%)\n", 
           current_fds, nofile_limit.rlim_cur, fd_usage_percent);
    
    if (fd_usage_percent > 80.0) {
        printf("âš ï¸  è­¦å‘Š: æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨ç‡è¿‡é«˜!\n");
    }
    
    // æ£€æŸ¥å†…å­˜ä½¿ç”¨
    getrusage(RUSAGE_SELF, &usage);
    printf("è¿›ç¨‹å†…å­˜ä½¿ç”¨: %ld KB\n", usage.ru_maxrss);
    
    // æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
    FILE *loadavg = fopen("/proc/loadavg", "r");
    if (loadavg) {
        double load1, load5, load15;
        fscanf(loadavg, "%lf %lf %lf", &load1, &load5, &load15);
        fclose(loadavg);
        
        printf("ç³»ç»Ÿè´Ÿè½½: %.2f (1åˆ†é’Ÿ)\n", load1);
        
        long cpu_count = sysconf(_SC_NPROCESSORS_ONLN);
        if (load1 > cpu_count * 1.5) {
            printf("âš ï¸  è­¦å‘Š: ç³»ç»Ÿè´Ÿè½½è¿‡é«˜!\n");
        }
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç³»ç»Ÿä¿¡æ¯è·å–çš„æœ¬è´¨ï¼šç¨‹åºè¿è¡Œæ—¶åŠ¨æ€æŸ¥è¯¢ç³»ç»ŸçŠ¶æ€çš„èƒ½åŠ›
ğŸ”¸ ä¸¤ç§è·å–æ–¹å¼ï¼šç³»ç»Ÿè°ƒç”¨æ¥å£ + è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ(/procã€/sys)
ğŸ”¸ æ ¸å¿ƒå‡½æ•°æŒæ¡ï¼šuname()ã€sysinfo()ã€getrusage()ã€sysconf()
ğŸ”¸ /procæ–‡ä»¶ç³»ç»Ÿï¼šLinuxç³»ç»Ÿä¿¡æ¯çš„"æ•°æ®åº“"ï¼Œå®æ—¶æ›´æ–°
ğŸ”¸ èµ„æºé™åˆ¶ç®¡ç†ï¼šä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§çš„é‡è¦æœºåˆ¶
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ç³»ç»Ÿä¿¡æ¯è·å–**
```
å®é™…ä»·å€¼ï¼š
â€¢ æ€§èƒ½ç›‘æ§ï¼šäº†è§£ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
â€¢ å®¹é‡è§„åˆ’ï¼šæ ¹æ®ç¡¬ä»¶é…ç½®åšå‡ºå†³ç­–
â€¢ é—®é¢˜è¯Šæ–­ï¼šé€šè¿‡ç³»ç»ŸçŠ¶æ€å®šä½é—®é¢˜
â€¢ ç¨‹åºä¼˜åŒ–ï¼šæ ¹æ®ç³»ç»Ÿç‰¹æ€§è°ƒæ•´ç¨‹åºè¡Œä¸º
```

**ğŸ”¹ å„æ¥å£çš„é€‚ç”¨åœºæ™¯**
```
uname()ï¼š     ç³»ç»Ÿè¯†åˆ«ã€å…¼å®¹æ€§æ£€æŸ¥
sysinfo()ï¼š   å®æ—¶æ€§èƒ½ç›‘æ§ã€èµ„æºç»Ÿè®¡
/procæ–‡ä»¶ï¼š   è¯¦ç»†ä¿¡æ¯è·å–ã€è¿›ç¨‹ç›‘æ§
sysconf()ï¼š   ç¨‹åºé…ç½®ä¼˜åŒ–ã€å‚æ•°æŸ¥è¯¢
getrusage()ï¼š æ€§èƒ½åˆ†æã€èµ„æºä½¿ç”¨è¿½è¸ª
```

**ğŸ”¹ Linuxç³»ç»Ÿä¿¡æ¯çš„ç‰¹ç‚¹**
```
å®æ—¶æ€§ï¼šä¿¡æ¯éšç³»ç»ŸçŠ¶æ€å®æ—¶å˜åŒ–
å±‚æ¬¡æ€§ï¼šä»ç³»ç»Ÿçº§åˆ°è¿›ç¨‹çº§çš„å¤šå±‚ä¿¡æ¯
å¯ç¼–ç¨‹ï¼šé€šè¿‡æ ‡å‡†æ¥å£è®¿é—®ï¼Œä¾¿äºè‡ªåŠ¨åŒ–
ä¸°å¯Œæ€§ï¼šæ¶µç›–ç¡¬ä»¶ã€è½¯ä»¶ã€ç½‘ç»œç­‰å„æ–¹é¢
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**æ€§èƒ½ç›‘æ§ç¨‹åºå¼€å‘ï¼š**
- ä½¿ç”¨ `sysinfo()` è·å–ç³»ç»Ÿæ•´ä½“çŠ¶æ€
- é€šè¿‡ `/proc/stat` è®¡ç®—CPUä½¿ç”¨ç‡
- åˆ©ç”¨ `/proc/meminfo` åˆ†æå†…å­˜ä½¿ç”¨
- ç”¨ `getrusage()` è¿½è¸ªè¿›ç¨‹èµ„æºæ¶ˆè€—

**ç³»ç»Ÿç®¡ç†å·¥å…·å¼€å‘ï¼š**
- ç”¨ `uname()` è¯†åˆ«ç³»ç»Ÿç±»å‹å’Œç‰ˆæœ¬
- é€šè¿‡ `/proc/cpuinfo` è·å–ç¡¬ä»¶è¯¦æƒ…
- ä½¿ç”¨ `sysconf()` æŸ¥è¯¢ç³»ç»Ÿé™åˆ¶å’Œé…ç½®
- åˆ©ç”¨èµ„æºé™åˆ¶æ¥å£ä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§

**ç¨‹åºæ€§èƒ½ä¼˜åŒ–ï¼š**
- æ ¹æ® `sysconf(_SC_NPROCESSORS_ONLN)` è®¾ç½®çº¿ç¨‹æ•°
- æŒ‰ `sysconf(_SC_PAGE_SIZE)` è¿›è¡Œå†…å­˜å¯¹é½
- é€šè¿‡ `getrusage()` åˆ†ææ€§èƒ½ç“¶é¢ˆ
- åˆ©ç”¨ç³»ç»Ÿè´Ÿè½½ä¿¡æ¯è°ƒæ•´å¹¶å‘åº¦

### 10.4 ç¼–ç¨‹å®è·µè¦ç‚¹


**é”™è¯¯å¤„ç†ï¼š**
```c
// å§‹ç»ˆæ£€æŸ¥ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼
if (uname(&sys_info) == -1) {
    perror("uname failed");
    // æä¾›é™çº§æ–¹æ¡ˆæˆ–é€€å‡º
}
```

**èµ„æºç®¡ç†ï¼š**
```c
// åŠæ—¶å…³é—­æ–‡ä»¶æè¿°ç¬¦
FILE *fp = fopen("/proc/cpuinfo", "r");
if (fp) {
    // å¤„ç†æ–‡ä»¶å†…å®¹
    fclose(fp);  // ç¡®ä¿å…³é—­
}
```

**è·¨å¹³å°å…¼å®¹ï¼š**
```c
// ä½¿ç”¨æ¡ä»¶ç¼–è¯‘å¤„ç†å¹³å°å·®å¼‚
#ifdef __linux__
    // Linuxç‰¹æœ‰çš„å®ç°
    sysinfo(&si);
#else
    // å…¶ä»–å¹³å°çš„å®ç°
    // æˆ–æä¾›é»˜è®¤å€¼
#endif
```

### 10.5 å¸¸è§åº”ç”¨æ¨¡å¼


**ç›‘æ§å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼š**
```
å®šæ—¶é‡‡é›† â†’ æ•°æ®åˆ†æ â†’ çŠ¶æ€åˆ¤æ–­ â†’ å‘Šè­¦å¤„ç†
```

**æ€§èƒ½åŸºå‡†æµ‹è¯•æ¨¡å¼ï¼š**
```
è®°å½•å¼€å§‹çŠ¶æ€ â†’ æ‰§è¡Œæµ‹è¯• â†’ è®°å½•ç»“æŸçŠ¶æ€ â†’ è®¡ç®—å·®å€¼åˆ†æ
```

**è‡ªé€‚åº”é…ç½®æ¨¡å¼ï¼š**
```
æ£€æµ‹ç³»ç»Ÿé…ç½® â†’ è®¡ç®—æœ€ä¼˜å‚æ•° â†’ åŠ¨æ€è°ƒæ•´ç¨‹åºè¡Œä¸º
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹ï¼š**
- ç³»ç»Ÿä¿¡æ¯è·å–æ˜¯ç³»ç»Ÿç¼–ç¨‹çš„åŸºç¡€æŠ€èƒ½
- Linuxçš„"ä¸€åˆ‡çš†æ–‡ä»¶"å“²å­¦ä½¿ä¿¡æ¯è·å–å˜å¾—ç®€å•
- ä¸åŒæ¥å£é€‚ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯
- å®æ—¶æ€§å’Œå‡†ç¡®æ€§æ˜¯ç³»ç»Ÿä¿¡æ¯çš„æ ¸å¿ƒä»·å€¼
- åˆç†çš„èµ„æºé™åˆ¶æ˜¯ç³»ç»Ÿç¨³å®šè¿è¡Œçš„ä¿éšœ