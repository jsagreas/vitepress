---
title: 4ã€ä¿¡å·æœºåˆ¶ä¸å¤„ç†
---
## ğŸ“š ç›®å½•

1. [ä¿¡å·æ¦‚å¿µä¸åŸºæœ¬åŸç†](#1-ä¿¡å·æ¦‚å¿µä¸åŸºæœ¬åŸç†)
2. [ä¿¡å·ç”Ÿå‘½å‘¨æœŸè¯¦è§£](#2-ä¿¡å·ç”Ÿå‘½å‘¨æœŸè¯¦è§£)
3. [æ ‡å‡†ä¿¡å·åˆ—è¡¨ä¸é»˜è®¤è¡Œä¸º](#3-æ ‡å‡†ä¿¡å·åˆ—è¡¨ä¸é»˜è®¤è¡Œä¸º)
4. [ä¿¡å·å¤„ç†å‡½æ•°æ³¨å†Œ](#4-ä¿¡å·å¤„ç†å‡½æ•°æ³¨å†Œ)
5. [ä¿¡å·å‘é€ä¸æ¥æ”¶æœºåˆ¶](#5-ä¿¡å·å‘é€ä¸æ¥æ”¶æœºåˆ¶)
6. [ä¿¡å·æ©ç ä¸é˜»å¡æœºåˆ¶](#6-ä¿¡å·æ©ç ä¸é˜»å¡æœºåˆ¶)
7. [å¯é ä¿¡å·ä¸ä¸å¯é ä¿¡å·](#7-å¯é ä¿¡å·ä¸ä¸å¯é ä¿¡å·)
8. [ä¿¡å·å¤„ç†å®‰å…¨æ€§è€ƒè™‘](#8-ä¿¡å·å¤„ç†å®‰å…¨æ€§è€ƒè™‘)
9. [å®æ—¶ä¿¡å·ä¸ä¿¡å·é˜Ÿåˆ—](#9-å®æ—¶ä¿¡å·ä¸ä¿¡å·é˜Ÿåˆ—)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ ä¿¡å·æ¦‚å¿µä¸åŸºæœ¬åŸç†


### 1.1 ä»€ä¹ˆæ˜¯ä¿¡å·


**ğŸ”¸ é€šä¿—ç†è§£**
```
ä¿¡å·å°±åƒæ˜¯è¿›ç¨‹é—´çš„"çŸ­ä¿¡æ¯"æˆ–"é€šçŸ¥"
- å†…æ ¸å‘ç»™è¿›ç¨‹ï¼šå‘Šè¯‰ä½ å‘ç”Ÿäº†ä»€ä¹ˆäº‹
- è¿›ç¨‹å‘ç»™è¿›ç¨‹ï¼šä¼ é€’ç®€å•çš„é€šçŸ¥
- ç”¨æˆ·å‘ç»™è¿›ç¨‹ï¼šé€šè¿‡é”®ç›˜æ“ä½œæ§åˆ¶ç¨‹åº
```

**ğŸ’¡ ä¿¡å·çš„æœ¬è´¨**
ä¿¡å·æ˜¯Linuxç³»ç»Ÿä¸­ä¸€ç§**å¼‚æ­¥é€šä¿¡æœºåˆ¶**ï¼Œç”¨äºåœ¨è¿›ç¨‹ä¹‹é—´æˆ–å†…æ ¸ä¸è¿›ç¨‹ä¹‹é—´ä¼ é€’ç®€å•çš„æ¶ˆæ¯ã€‚å®ƒç›¸å½“äºè½¯ä»¶å±‚é¢çš„"ä¸­æ–­"ã€‚

### 1.2 ä¿¡å·çš„ç‰¹ç‚¹


**ğŸ¯ æ ¸å¿ƒç‰¹å¾**
- **å¼‚æ­¥æ€§**ï¼šä¿¡å·éšæ—¶å¯èƒ½åˆ°è¾¾ï¼Œä¸å¯é¢„æµ‹
- **ç®€å•æ€§**ï¼šåªèƒ½ä¼ é€’ä¿¡å·ç±»å‹ï¼Œä¸èƒ½æºå¸¦å¤æ‚æ•°æ®
- **ä¼˜å…ˆæ€§**ï¼šä¿¡å·ä¼šä¸­æ–­è¿›ç¨‹æ­£å¸¸æ‰§è¡Œæµç¨‹
- **æœ‰é™æ€§**ï¼šä¿¡å·ç§ç±»æ˜¯é¢„å®šä¹‰çš„ï¼Œæ•°é‡æœ‰é™

### 1.3 ä¿¡å·å·¥ä½œæœºåˆ¶å›¾ç¤º


```
å‘é€æ–¹                    å†…æ ¸                    æ¥æ”¶æ–¹
  |                        |                        |
  |--[1]å‘é€ä¿¡å·----------->|                        |
  |   kill(pid, SIGTERM)   |                        |
  |                        |--[2]è®°å½•ä¿¡å·---------->|
  |                        |   è®¾ç½®pendingä½        |
  |                        |                        |
  |                        |<--[3]è¿›ç¨‹è°ƒåº¦----------|
  |                        |                        |
  |                        |--[4]æ£€æŸ¥ä¿¡å·---------->|
  |                        |   å¤„ç†pendingä¿¡å·      |
  |                        |                        |
  |                        |<--[5]æ‰§è¡Œå¤„ç†----------|
  |                        |   è°ƒç”¨ä¿¡å·å¤„ç†å‡½æ•°     |
```

### 1.4 ä¿¡å·ä¸ä¸­æ–­çš„åŒºåˆ«


| ç‰¹æ€§ | **ç¡¬ä»¶ä¸­æ–­** | **è½¯ä»¶ä¿¡å·** |
|------|-------------|-------------|
| **è§¦å‘æº** | `ç¡¬ä»¶è®¾å¤‡` | `å†…æ ¸æˆ–è¿›ç¨‹` |
| **å¤„ç†å±‚æ¬¡** | `å†…æ ¸æ€` | `ç”¨æˆ·æ€` |
| **å“åº”é€Ÿåº¦** | `ç«‹å³å“åº”` | `è°ƒåº¦æ—¶å“åº”` |
| **å¤„ç†æ–¹å¼** | `ä¸­æ–­å¤„ç†ç¨‹åº` | `ä¿¡å·å¤„ç†å‡½æ•°` |
| **æ•°æ®ä¼ é€’** | `å¯ä¼ é€’æ•°æ®` | `ä»…ä¼ é€’ä¿¡å·ç±»å‹` |

---

## 2. â³ ä¿¡å·ç”Ÿå‘½å‘¨æœŸè¯¦è§£


### 2.1 ä¿¡å·çš„ä¸‰ä¸ªçŠ¶æ€


**ğŸ“Š ä¿¡å·çŠ¶æ€è½¬æ¢**
```
ç”Ÿæˆ(Generated) â†’ å¾…å†³(Pending) â†’ é€’è¾¾(Delivered)
       â†“              â†“              â†“
    äº§ç”Ÿä¿¡å·        ç­‰å¾…å¤„ç†        æ‰§è¡Œå¤„ç†
```

### 2.2 çŠ¶æ€è¯¦ç»†è¯´æ˜


**ğŸ”¸ ç”Ÿæˆé˜¶æ®µï¼ˆGeneratedï¼‰**
- **å«ä¹‰**ï¼šä¿¡å·è¢«åˆ›å»ºï¼Œå‡†å¤‡å‘é€ç»™ç›®æ ‡è¿›ç¨‹
- **è§¦å‘æ¡ä»¶**ï¼š
  - ç”¨æˆ·æŒ‰é”®ï¼š`Ctrl+C` äº§ç”Ÿ `SIGINT`
  - ç¨‹åºé”™è¯¯ï¼šé™¤é›¶æ“ä½œäº§ç”Ÿ `SIGFPE`
  - ç³»ç»Ÿè°ƒç”¨ï¼š`kill()` å‡½æ•°å‘é€ä¿¡å·
  - å®šæ—¶å™¨ï¼š`alarm()` åˆ°æ—¶äº§ç”Ÿ `SIGALRM`

**ğŸ”¸ å¾…å†³é˜¶æ®µï¼ˆPendingï¼‰**
- **å«ä¹‰**ï¼šä¿¡å·å·²ç»å‘é€ç»™è¿›ç¨‹ï¼Œä½†å°šæœªè¢«å¤„ç†
- **å­˜å‚¨ä½ç½®**ï¼šå†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªpendingä½å›¾
- **æ³¨æ„**ï¼šåŒç±»å‹ä¿¡å·ä¸ä¼šæ’é˜Ÿï¼Œåæ¥çš„ä¼šè¦†ç›–å‰é¢çš„

**ğŸ”¸ é€’è¾¾é˜¶æ®µï¼ˆDeliveredï¼‰**
- **å«ä¹‰**ï¼šè¿›ç¨‹å¼€å§‹å¤„ç†ä¿¡å·ï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†åŠ¨ä½œ
- **å¤„ç†æ–¹å¼**ï¼š
  - æ‰§è¡Œé»˜è®¤åŠ¨ä½œ
  - å¿½ç•¥ä¿¡å·
  - æ‰§è¡Œè‡ªå®šä¹‰å¤„ç†å‡½æ•°

### 2.3 ä¿¡å·å¤„ç†æ—¶æœº


> ğŸ’¡ **é‡è¦æ¦‚å¿µ**ï¼šä¿¡å·ä¸æ˜¯ç«‹å³å¤„ç†çš„ï¼

**å¤„ç†æ—¶æœºè¯´æ˜**ï¼š
```
è¿›ç¨‹æ‰§è¡Œæµç¨‹ï¼š
ç”¨æˆ·æ€ä»£ç  â†’ ç³»ç»Ÿè°ƒç”¨ â†’ å†…æ ¸æ€ â†’ è¿”å›ç”¨æˆ·æ€
                                      â†‘
                                  æ£€æŸ¥pendingä¿¡å·
                                  æ‰§è¡Œä¿¡å·å¤„ç†
```

**âš ï¸ å…³é”®ç†è§£**ï¼š
- ä¿¡å·åªåœ¨ç‰¹å®šæ—¶æœºè¢«æ£€æŸ¥å’Œå¤„ç†
- é€šå¸¸åœ¨ç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶æˆ–è¿›ç¨‹è°ƒåº¦æ—¶
- ä¿¡å·å¤„ç†å…·æœ‰ä¸€å®šçš„å»¶è¿Ÿæ€§

---

## 3. ğŸ“‹ æ ‡å‡†ä¿¡å·åˆ—è¡¨ä¸é»˜è®¤è¡Œä¸º


### 3.1 å¸¸ç”¨æ ‡å‡†ä¿¡å·


| ä¿¡å·åç§° | **ç¼–å·** | **é»˜è®¤è¡Œä¸º** | **è¯´æ˜** | **å¸¸è§è§¦å‘** |
|---------|---------|-------------|----------|-------------|
| `SIGHUP` | `1` | `ç»ˆæ­¢` | `æŒ‚èµ·ä¿¡å·` | `ç»ˆç«¯æ–­å¼€è¿æ¥` |
| `SIGINT` | `2` | `ç»ˆæ­¢` | `ä¸­æ–­ä¿¡å·` | `Ctrl+C` |
| `SIGQUIT` | `3` | `ç»ˆæ­¢+æ ¸å¿ƒè½¬å‚¨` | `é€€å‡ºä¿¡å·` | `Ctrl+\` |
| `SIGILL` | `4` | `ç»ˆæ­¢+æ ¸å¿ƒè½¬å‚¨` | `éæ³•æŒ‡ä»¤` | `ç¨‹åºé”™è¯¯` |
| `SIGFPE` | `8` | `ç»ˆæ­¢+æ ¸å¿ƒè½¬å‚¨` | `æµ®ç‚¹å¼‚å¸¸` | `é™¤é›¶æ“ä½œ` |
| `SIGKILL` | `9` | `ç»ˆæ­¢` | `å¼ºåˆ¶æ€æ­»` | `kill -9` |
| `SIGSEGV` | `11` | `ç»ˆæ­¢+æ ¸å¿ƒè½¬å‚¨` | `æ®µé”™è¯¯` | `è®¿é—®éæ³•å†…å­˜` |
| `SIGPIPE` | `13` | `ç»ˆæ­¢` | `ç®¡é“ç ´è£‚` | `å†™å…¥å·²å…³é—­ç®¡é“` |
| `SIGALRM` | `14` | `ç»ˆæ­¢` | `å®šæ—¶å™¨åˆ°æ—¶` | `alarm()` |
| `SIGTERM` | `15` | `ç»ˆæ­¢` | `ç»ˆæ­¢è¯·æ±‚` | `killå‘½ä»¤é»˜è®¤` |
| `SIGCHLD` | `17` | `å¿½ç•¥` | `å­è¿›ç¨‹çŠ¶æ€æ”¹å˜` | `å­è¿›ç¨‹é€€å‡º` |
| `SIGCONT` | `18` | `ç»§ç»­` | `ç»§ç»­æ‰§è¡Œ` | `fgå‘½ä»¤` |
| `SIGSTOP` | `19` | `åœæ­¢` | `åœæ­¢æ‰§è¡Œ` | `Ctrl+Z` |

### 3.2 é»˜è®¤å¤„ç†è¡Œä¸ºåˆ†ç±»


**ğŸ¯ äº”ç§é»˜è®¤è¡Œä¸º**
```
Term (ç»ˆæ­¢)ï¼šè¿›ç¨‹ç»ˆæ­¢
Ign (å¿½ç•¥)ï¼šå¿½ç•¥ä¿¡å·
Core (æ ¸å¿ƒè½¬å‚¨)ï¼šç»ˆæ­¢è¿›ç¨‹å¹¶ç”Ÿæˆcoreæ–‡ä»¶
Stop (åœæ­¢)ï¼šæš‚åœè¿›ç¨‹æ‰§è¡Œ
Cont (ç»§ç»­)ï¼šæ¢å¤è¿›ç¨‹æ‰§è¡Œ
```

### 3.3 ç‰¹æ®Šä¿¡å·è¯´æ˜


**ğŸš¨ ä¸å¯æ•è·çš„ä¿¡å·**
- **SIGKILL (9)**ï¼šæ— æ¡ä»¶ç»ˆæ­¢ï¼Œä¸èƒ½è¢«æ•è·æˆ–å¿½ç•¥
- **SIGSTOP (19)**ï¼šæ— æ¡ä»¶åœæ­¢ï¼Œä¸èƒ½è¢«æ•è·æˆ–å¿½ç•¥

> âš ï¸ **é‡è¦**ï¼šè¿™ä¸¤ä¸ªä¿¡å·ç¡®ä¿ç³»ç»Ÿç®¡ç†å‘˜å§‹ç»ˆèƒ½å¤Ÿæ§åˆ¶è¿›ç¨‹

**ğŸ’¡ å¸¸ç”¨ä¿¡å·å®é™…ç”¨é€”**
- **SIGTERM**ï¼šä¼˜é›…å…³é—­ç¨‹åºçš„é¦–é€‰ä¿¡å·
- **SIGINT**ï¼šç”¨æˆ·ä¸­æ–­ç¨‹åºçš„æ ‡å‡†æ–¹å¼
- **SIGHUP**ï¼šé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶çš„å¸¸ç”¨ä¿¡å·
- **SIGCHLD**ï¼šçˆ¶è¿›ç¨‹ç›‘æ§å­è¿›ç¨‹çŠ¶æ€å˜åŒ–

---

## 4. ğŸ”§ ä¿¡å·å¤„ç†å‡½æ•°æ³¨å†Œ


### 4.1 signal()å‡½æ•° - ç®€å•æ–¹å¼


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <signal.h>
typedef void (*sighandler_t)(int);
sighandler_t signal(int signum, sighandler_t handler);
```

**ğŸ’¡ å‚æ•°è¯´æ˜**
- `signum`ï¼šè¦å¤„ç†çš„ä¿¡å·ç¼–å·
- `handler`ï¼šå¤„ç†å‡½æ•°æŒ‡é’ˆï¼Œå¯ä»¥æ˜¯ï¼š
  - è‡ªå®šä¹‰å‡½æ•°åœ°å€
  - `SIG_DFL`ï¼ˆé»˜è®¤å¤„ç†ï¼‰
  - `SIG_IGN`ï¼ˆå¿½ç•¥ä¿¡å·ï¼‰

**ğŸ¯ ç®€å•ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

// ä¿¡å·å¤„ç†å‡½æ•°
void sigint_handler(int sig) {
    printf("æ”¶åˆ°SIGINTä¿¡å·ï¼Œä½†æˆ‘ä¸æƒ³é€€å‡ºï¼\n");
}

int main() {
    // æ³¨å†ŒSIGINTä¿¡å·å¤„ç†å‡½æ•°
    signal(SIGINT, sigint_handler);
    
    printf("ç¨‹åºè¿è¡Œä¸­ï¼ŒæŒ‰Ctrl+Cè¯•è¯•...\n");
    while(1) {
        sleep(1);
        printf("ç¨‹åºæ­£åœ¨è¿è¡Œ...\n");
    }
    return 0;
}
```

### 4.2 sigaction()å‡½æ•° - é«˜çº§æ–¹å¼


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <signal.h>
int sigaction(int signum, const struct sigaction *act, 
              struct sigaction *oldact);
```

**ğŸ“Š sigactionç»“æ„ä½“**
```c
struct sigaction {
    void (*sa_handler)(int);           // ä¿¡å·å¤„ç†å‡½æ•°
    void (*sa_sigaction)(int, siginfo_t *, void *);  // é«˜çº§å¤„ç†å‡½æ•°
    sigset_t sa_mask;                  // å¤„ç†æœŸé—´è¦é˜»å¡çš„ä¿¡å·
    int sa_flags;                      // æ§åˆ¶æ ‡å¿—
    void (*sa_restorer)(void);         // å·²åºŸå¼ƒï¼Œè®¾ä¸ºNULL
};
```

**ğŸ¯ sigaction()ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <string.h>

void sigint_handler(int sig) {
    printf("é€šè¿‡sigactionæ•è·SIGINTä¿¡å·\n");
}

int main() {
    struct sigaction sa;
    
    // æ¸…é›¶ç»“æ„ä½“
    memset(&sa, 0, sizeof(sa));
    
    // è®¾ç½®å¤„ç†å‡½æ•°
    sa.sa_handler = sigint_handler;
    
    // å¤„ç†ä¿¡å·æœŸé—´é˜»å¡SIGQUIT
    sigemptyset(&sa.sa_mask);
    sigaddset(&sa.sa_mask, SIGQUIT);
    
    // è®¾ç½®æ ‡å¿—
    sa.sa_flags = SA_RESTART;
    
    // æ³¨å†Œä¿¡å·å¤„ç†
    sigaction(SIGINT, &sa, NULL);
    
    while(1) {
        pause();  // ç­‰å¾…ä¿¡å·
    }
    return 0;
}
```

### 4.3 signal() vs sigaction() å¯¹æ¯”


| ç‰¹æ€§ | **signal()** | **sigaction()** |
|------|-------------|----------------|
| **å¤æ‚åº¦** | `ç®€å•` | `å¤æ‚` |
| **å¯ç§»æ¤æ€§** | `è¾ƒå·®` | `å¥½` |
| **åŠŸèƒ½** | `åŸºæœ¬` | `ä¸°å¯Œ` |
| **ä¿¡å·é˜»å¡** | `ä¸æ”¯æŒ` | `æ”¯æŒ` |
| **ä¿¡å·ä¿¡æ¯** | `ä¸æ”¯æŒ` | `æ”¯æŒ` |
| **æ¨èä½¿ç”¨** | `ç®€å•åœºæ™¯` | `ä¸“ä¸šå¼€å‘` |

> ğŸ“ **å»ºè®®**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­æ¨èä½¿ç”¨ `sigaction()`ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ä¸”è¡Œä¸ºæ›´å¯é 

---

## 5. ğŸ“¡ ä¿¡å·å‘é€ä¸æ¥æ”¶æœºåˆ¶


### 5.1 ä¿¡å·å‘é€å‡½æ•°


**ğŸ”¸ kill()å‡½æ•° - å‘æŒ‡å®šè¿›ç¨‹å‘é€ä¿¡å·**
```c
#include <sys/types.h>
#include <signal.h>
int kill(pid_t pid, int sig);
```

**ğŸ’¡ pidå‚æ•°å«ä¹‰**
- `pid > 0`ï¼šå‘é€ç»™æŒ‡å®šè¿›ç¨‹ID
- `pid = 0`ï¼šå‘é€ç»™åŒè¿›ç¨‹ç»„çš„æ‰€æœ‰è¿›ç¨‹
- `pid = -1`ï¼šå‘é€ç»™æ‰€æœ‰æœ‰æƒé™å‘é€çš„è¿›ç¨‹
- `pid < -1`ï¼šå‘é€ç»™è¿›ç¨‹ç»„IDä¸º|pid|çš„æ‰€æœ‰è¿›ç¨‹

**ğŸ¯ kill()ä½¿ç”¨ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

int main() {
    pid_t child_pid;
    
    child_pid = fork();
    if (child_pid == 0) {
        // å­è¿›ç¨‹ï¼šç­‰å¾…ä¿¡å·
        printf("å­è¿›ç¨‹ç­‰å¾…ä¿¡å·...\n");
        pause();
        printf("å­è¿›ç¨‹æ”¶åˆ°ä¿¡å·ï¼Œé€€å‡º\n");
    } else {
        // çˆ¶è¿›ç¨‹ï¼šå‘é€ä¿¡å·
        sleep(2);
        printf("çˆ¶è¿›ç¨‹å‘é€SIGTERMç»™å­è¿›ç¨‹\n");
        kill(child_pid, SIGTERM);
        wait(NULL);
    }
    return 0;
}
```

**ğŸ”¸ raise()å‡½æ•° - å‘è‡ªå·±å‘é€ä¿¡å·**
```c
#include <signal.h>
int raise(int sig);
```

**ğŸ’¡ ç­‰ä»·å…³ç³»**
```c
raise(sig);
// ç­‰ä»·äº
kill(getpid(), sig);
```

### 5.2 ä¿¡å·æ¥æ”¶æœºåˆ¶


**ğŸ”¸ pause()å‡½æ•° - ç­‰å¾…ä¿¡å·**
```c
#include <unistd.h>
int pause(void);
```

**å«ä¹‰**ï¼šä½¿è¿›ç¨‹æŒ‚èµ·ç›´åˆ°æ”¶åˆ°ä¿¡å·

**ğŸ”¸ alarm()å‡½æ•° - å®šæ—¶ä¿¡å·**
```c
#include <unistd.h>
unsigned int alarm(unsigned int seconds);
```

**ğŸ¯ å®šæ—¶å™¨ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void alarm_handler(int sig) {
    printf("æ—¶é—´åˆ°ï¼æ”¶åˆ°SIGALRMä¿¡å·\n");
}

int main() {
    signal(SIGALRM, alarm_handler);
    
    printf("è®¾ç½®3ç§’å®šæ—¶å™¨\n");
    alarm(3);
    
    printf("ç­‰å¾…å®šæ—¶å™¨åˆ°æ—¶...\n");
    pause();
    
    printf("ç¨‹åºç»§ç»­æ‰§è¡Œ\n");
    return 0;
}
```

### 5.3 ä¿¡å·å‘é€æƒé™


**ğŸ”’ æƒé™è§„åˆ™**
- **ç›¸åŒç”¨æˆ·**ï¼šå¯ä»¥äº’ç›¸å‘é€ä¿¡å·
- **rootç”¨æˆ·**ï¼šå¯ä»¥å‘ä»»ä½•è¿›ç¨‹å‘é€ä¿¡å·
- **æ™®é€šç”¨æˆ·**ï¼šåªèƒ½å‘è‡ªå·±çš„è¿›ç¨‹å‘é€ä¿¡å·

**âš ï¸ å®‰å…¨è€ƒè™‘**
- ç³»ç»Ÿé€šè¿‡è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·IDæ£€æŸ¥æƒé™
- é˜²æ­¢æ¶æ„è¿›ç¨‹æ”»å‡»å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹

---

## 6. ğŸ›¡ï¸ ä¿¡å·æ©ç ä¸é˜»å¡æœºåˆ¶


### 6.1 ä¿¡å·æ©ç æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä¿¡å·æ©ç **
ä¿¡å·æ©ç æ˜¯æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰çš„ä¸€ä¸ª**ä¿¡å·é›†åˆ**ï¼Œç”¨äºæŒ‡å®šå“ªäº›ä¿¡å·å½“å‰è¢«**é˜»å¡**ï¼ˆæš‚æ—¶ä¸å¤„ç†ï¼‰ã€‚

**ğŸ’¡ é˜»å¡ä¸å¿½ç•¥çš„åŒºåˆ«**
- **é˜»å¡**ï¼šä¿¡å·è¢«æš‚æ—¶"æ”¾åœ¨ä¸€è¾¹"ï¼Œç­‰è§£é™¤é˜»å¡åå†å¤„ç†
- **å¿½ç•¥**ï¼šä¿¡å·è¢«æ°¸ä¹…"ä¸¢å¼ƒ"ï¼Œä¸ä¼šè¢«å¤„ç†

### 6.2 ä¿¡å·é›†æ“ä½œå‡½æ•°


**ğŸ”¸ ä¿¡å·é›†ç±»å‹**
```c
#include <signal.h>
typedef struct {
    unsigned long sig[_NSIG_WORDS];
} sigset_t;
```

**ğŸ”¸ ä¿¡å·é›†æ“ä½œå‡½æ•°**
```c
// æ¸…ç©ºä¿¡å·é›†
int sigemptyset(sigset_t *set);

// å¡«æ»¡ä¿¡å·é›†ï¼ˆåŒ…å«æ‰€æœ‰ä¿¡å·ï¼‰
int sigfillset(sigset_t *set);

// æ·»åŠ ä¿¡å·åˆ°é›†åˆ
int sigaddset(sigset_t *set, int signum);

// ä»é›†åˆä¸­åˆ é™¤ä¿¡å·
int sigdelset(sigset_t *set, int signum);

// æµ‹è¯•ä¿¡å·æ˜¯å¦åœ¨é›†åˆä¸­
int sigismember(const sigset_t *set, int signum);
```

### 6.3 sigprocmask()å‡½æ•°


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <signal.h>
int sigprocmask(int how, const sigset_t *set, sigset_t *oldset);
```

**ğŸ’¡ howå‚æ•°è¯´æ˜**
- `SIG_BLOCK`ï¼šå°†setä¸­çš„ä¿¡å·æ·»åŠ åˆ°ä¿¡å·æ©ç ä¸­
- `SIG_UNBLOCK`ï¼šä»ä¿¡å·æ©ç ä¸­ç§»é™¤setä¸­çš„ä¿¡å·
- `SIG_SETMASK`ï¼šå°†ä¿¡å·æ©ç è®¾ç½®ä¸ºset

**ğŸ¯ ä¿¡å·æ©ç ä½¿ç”¨ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void sigint_handler(int sig) {
    printf("æ”¶åˆ°SIGINTä¿¡å·\n");
}

int main() {
    sigset_t new_mask, old_mask;
    
    // æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°
    signal(SIGINT, sigint_handler);
    
    // åˆ›å»ºä¿¡å·é›†ï¼ŒåŒ…å«SIGINT
    sigemptyset(&new_mask);
    sigaddset(&new_mask, SIGINT);
    
    printf("é˜»å¡SIGINTä¿¡å·ï¼ŒæŒ‰Ctrl+Cè¯•è¯•...\n");
    // é˜»å¡SIGINTä¿¡å·
    sigprocmask(SIG_BLOCK, &new_mask, &old_mask);
    
    sleep(5);  // SIGINTåœ¨æ­¤æœŸé—´è¢«é˜»å¡
    
    printf("è§£é™¤é˜»å¡ï¼Œå¤„ç†å¾…å†³ä¿¡å·\n");
    // æ¢å¤åŸæ¥çš„ä¿¡å·æ©ç 
    sigprocmask(SIG_SETMASK, &old_mask, NULL);
    
    sleep(2);  // ç°åœ¨SIGINTå¯ä»¥æ­£å¸¸å¤„ç†
    return 0;
}
```

### 6.4 sigsuspend()å‡½æ•°


**ğŸ”¸ å‡½æ•°åŸå‹**
```c
#include <signal.h>
int sigsuspend(const sigset_t *mask);
```

**å«ä¹‰**ï¼šåŸå­æ€§åœ°æ”¹å˜ä¿¡å·æ©ç å¹¶ç­‰å¾…ä¿¡å·

**ğŸ’¡ ç­‰ä»·æ“ä½œ**
```c
// sigsuspend(&mask) ç­‰ä»·äºï¼š
sigprocmask(SIG_SETMASK, &mask, &old_mask);
pause();
sigprocmask(SIG_SETMASK, &old_mask, NULL);
```

**ğŸ¯ sigsuspend()ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>

void sigusr1_handler(int sig) {
    printf("æ”¶åˆ°SIGUSR1ä¿¡å·\n");
}

int main() {
    sigset_t new_mask, old_mask, wait_mask;
    
    signal(SIGUSR1, sigusr1_handler);
    
    // é˜»å¡SIGUSR1
    sigemptyset(&new_mask);
    sigaddset(&new_mask, SIGUSR1);
    sigprocmask(SIG_BLOCK, &new_mask, &old_mask);
    
    // åˆ›å»ºç­‰å¾…æ©ç ï¼ˆä¸åŒ…å«SIGUSR1ï¼‰
    sigfillset(&wait_mask);
    sigdelset(&wait_mask, SIGUSR1);
    
    printf("ç­‰å¾…SIGUSR1ä¿¡å·...\n");
    // åŸå­æ€§åœ°è§£é™¤SIGUSR1é˜»å¡å¹¶ç­‰å¾…
    sigsuspend(&wait_mask);
    
    printf("æ”¶åˆ°ä¿¡å·ï¼Œç»§ç»­æ‰§è¡Œ\n");
    sigprocmask(SIG_SETMASK, &old_mask, NULL);
    return 0;
}
```

---

## 7. âš¡ å¯é ä¿¡å·ä¸ä¸å¯é ä¿¡å·


### 7.1 åŸºæœ¬æ¦‚å¿µåŒºåˆ«


**ğŸ”¸ ä¸å¯é ä¿¡å·ï¼ˆ1-31ï¼‰**
- **ä¿¡å·ç¼–å·**ï¼š1åˆ°31
- **ç‰¹ç‚¹**ï¼šä¸æ”¯æŒæ’é˜Ÿï¼ŒåŒç±»å‹ä¿¡å·ä¼šä¸¢å¤±
- **å†å²åŸå› **ï¼šæ—©æœŸUNIXç³»ç»Ÿçš„ä¿¡å·æœºåˆ¶

**ğŸ”¸ å¯é ä¿¡å·ï¼ˆ34-64ï¼‰**
- **ä¿¡å·ç¼–å·**ï¼š34åˆ°64ï¼ˆå®æ—¶ä¿¡å·ï¼‰
- **ç‰¹ç‚¹**ï¼šæ”¯æŒæ’é˜Ÿï¼Œä¸ä¼šä¸¢å¤±
- **ä¼˜åŠ¿**ï¼šå¯ä»¥æºå¸¦æ•°æ®ï¼ŒæŒ‰é¡ºåºå¤„ç†

### 7.2 ä¸å¯é ä¿¡å·çš„é—®é¢˜


**âš ï¸ ä¿¡å·ä¸¢å¤±é—®é¢˜**
```
åœºæ™¯è¯´æ˜ï¼š
1. è¿›ç¨‹æ”¶åˆ°SIGUSR1ä¿¡å·ï¼Œæ­£åœ¨å¤„ç†ä¸­
2. åˆæ¥äº†ä¸€ä¸ªSIGUSR1ä¿¡å·
3. ç¬¬äºŒä¸ªä¿¡å·ä¼šè¢«ä¸¢å¤±ï¼

åŸå› ï¼špendingä½åªæœ‰ä¸€ä½ï¼Œä¸èƒ½è®°å½•ä¿¡å·æ•°é‡
```

**ğŸ¯ ä¿¡å·ä¸¢å¤±æ¼”ç¤º**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

int signal_count = 0;

void sigusr1_handler(int sig) {
    signal_count++;
    printf("å¤„ç†ç¬¬%dä¸ªSIGUSR1ä¿¡å·\n", signal_count);
    sleep(3);  // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
}

int main() {
    signal(SIGUSR1, sigusr1_handler);
    
    printf("è¿›ç¨‹PID: %d\n", getpid());
    printf("å¿«é€Ÿå‘é€å¤šä¸ªSIGUSR1ä¿¡å·æµ‹è¯•...\n");
    
    while(1) {
        pause();
    }
    return 0;
}
```

æµ‹è¯•æ–¹æ³•ï¼š
```bash
# ç¼–è¯‘è¿è¡Œç¨‹åº
gcc -o signal_test signal_test.c
./signal_test &
PID=$!

# å¿«é€Ÿå‘é€å¤šä¸ªä¿¡å·
for i in {1..5}; do
    kill -USR1 $PID
done
```

### 7.3 å¯é ä¿¡å·çš„ä¼˜åŠ¿


**âœ… å¯é ä¿¡å·ç‰¹ç‚¹**
- **æ’é˜Ÿæœºåˆ¶**ï¼šå¤šä¸ªåŒç±»å‹ä¿¡å·ä¼šæ’é˜Ÿç­‰å¾…å¤„ç†
- **æ•°æ®ä¼ é€’**ï¼šå¯ä»¥æºå¸¦æ•´æ•°æˆ–æŒ‡é’ˆæ•°æ®
- **ä¼˜å…ˆçº§**ï¼šå®æ—¶ä¿¡å·æœ‰ä¼˜å…ˆçº§æ¦‚å¿µ

### 7.4 ä¿¡å·å¯é æ€§å¯¹æ¯”


| ç‰¹æ€§ | **ä¸å¯é ä¿¡å·(1-31)** | **å¯é ä¿¡å·(34-64)** |
|------|-------------------|-------------------|
| **æ’é˜Ÿ** | `ä¸æ”¯æŒ` | `æ”¯æŒ` |
| **ä¸¢å¤±** | `å¯èƒ½ä¸¢å¤±` | `ä¸ä¼šä¸¢å¤±` |
| **æ•°æ®ä¼ é€’** | `ä¸æ”¯æŒ` | `æ”¯æŒ` |
| **å¤„ç†é¡ºåº** | `æ— åº` | `æŒ‰å‘é€é¡ºåº` |
| **åº”ç”¨åœºæ™¯** | `ç®€å•é€šçŸ¥` | `ç²¾ç¡®æ§åˆ¶` |

> ğŸ“ **å®é™…å»ºè®®**ï¼šå¯¹äºå…³é”®ä¸šåŠ¡é€»è¾‘ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨å¯é ä¿¡å·æˆ–å…¶ä»–IPCæœºåˆ¶

---

## 8. ğŸ”’ ä¿¡å·å¤„ç†å®‰å…¨æ€§è€ƒè™‘


### 8.1 ä¿¡å·å¤„ç†å‡½æ•°çš„é™åˆ¶


**âš ï¸ å®‰å…¨æ€§é—®é¢˜**
ä¿¡å·å¤„ç†å‡½æ•°æ˜¯**å¼‚æ­¥æ‰§è¡Œ**çš„ï¼Œå¯èƒ½åœ¨ä»»ä½•æ—¶å€™ä¸­æ–­ä¸»ç¨‹åºï¼Œå› æ­¤å­˜åœ¨**é‡å…¥æ€§**å’Œ**ç«æ€æ¡ä»¶**é—®é¢˜ã€‚

**ğŸš¨ ä¸å®‰å…¨çš„æ“ä½œ**
```c
// å±é™©ç¤ºä¾‹ï¼šåœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨éå¼‚æ­¥å®‰å…¨å‡½æ•°
void unsafe_handler(int sig) {
    printf("æ”¶åˆ°ä¿¡å·ï¼\n");        // printfä¸æ˜¯å¼‚æ­¥å®‰å…¨çš„
    malloc(100);                   // mallocä¸æ˜¯å¼‚æ­¥å®‰å…¨çš„
    fflush(stdout);               // fflushä¸æ˜¯å¼‚æ­¥å®‰å…¨çš„
}
```

### 8.2 å¼‚æ­¥å®‰å…¨å‡½æ•°


**âœ… å®‰å…¨çš„å‡½æ•°åˆ—è¡¨**
```
write()     - å†™æ–‡ä»¶æè¿°ç¬¦
read()      - è¯»æ–‡ä»¶æè¿°ç¬¦  
open()      - æ‰“å¼€æ–‡ä»¶
close()     - å…³é—­æ–‡ä»¶
signal()    - ä¿¡å·å¤„ç†
sigaction() - ä¿¡å·å¤„ç†
getpid()    - è·å–è¿›ç¨‹ID
alarm()     - è®¾ç½®å®šæ—¶å™¨
pause()     - ç­‰å¾…ä¿¡å·
sleep()     - ç¡çœ ï¼ˆæŸäº›å®ç°ä¸‹ä¸å®‰å…¨ï¼‰
```

**âŒ ä¸å®‰å…¨çš„å‡½æ•°**
```
printf()    - æ ¼å¼åŒ–è¾“å‡º
malloc()    - å†…å­˜åˆ†é…
free()      - å†…å­˜é‡Šæ”¾
fopen()     - æ–‡ä»¶æ“ä½œ
scanf()     - æ ¼å¼åŒ–è¾“å…¥
å¤§éƒ¨åˆ†åº“å‡½æ•° - å¯èƒ½ä½¿ç”¨é™æ€å˜é‡
```

### 8.3 å®‰å…¨çš„ä¿¡å·å¤„ç†ç¤ºä¾‹


**ğŸ¯ ä½¿ç”¨å¼‚æ­¥å®‰å…¨å‡½æ•°**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>
#include <string.h>

// å®‰å…¨çš„ä¿¡å·å¤„ç†å‡½æ•°
void safe_handler(int sig) {
    char msg[] = "æ”¶åˆ°ä¿¡å·ï¼Œå®‰å…¨å¤„ç†\n";
    write(STDOUT_FILENO, msg, strlen(msg));  // writeæ˜¯å¼‚æ­¥å®‰å…¨çš„
}

int main() {
    signal(SIGINT, safe_handler);
    
    printf("ç¨‹åºè¿è¡Œä¸­ï¼ŒæŒ‰Ctrl+Cæµ‹è¯•å®‰å…¨å¤„ç†\n");
    while(1) {
        pause();
    }
    return 0;
}
```

### 8.4 ä¿¡å·å¤„ç†æœ€ä½³å®è·µ


**ğŸ”¸ æœ€å°åŒ–åŸåˆ™**
```c
volatile sig_atomic_t signal_received = 0;

void minimal_handler(int sig) {
    signal_received = 1;  // åªè®¾ç½®æ ‡å¿—ä½
}

int main() {
    signal(SIGINT, minimal_handler);
    
    while(1) {
        if (signal_received) {
            printf("æ£€æµ‹åˆ°ä¿¡å·ï¼Œè¿›è¡Œå¤„ç†\n");
            signal_received = 0;
            // åœ¨ä¸»ç¨‹åºä¸­å®‰å…¨å¤„ç†
        }
        // æ­£å¸¸ä¸šåŠ¡é€»è¾‘
        usleep(100000);
    }
    return 0;
}
```

**ğŸ”¸ è‡ªç®¡é“æŠ€å·§**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

int signal_pipe[2];

void pipe_handler(int sig) {
    char byte = 1;
    write(signal_pipe[1], &byte, 1);  // å‘ç®¡é“å†™å…¥æ•°æ®
}

int main() {
    pipe(signal_pipe);  // åˆ›å»ºç®¡é“
    signal(SIGINT, pipe_handler);
    
    fd_set readfds;
    char byte;
    
    while(1) {
        FD_ZERO(&readfds);
        FD_SET(signal_pipe[0], &readfds);
        
        if (select(signal_pipe[0] + 1, &readfds, NULL, NULL, NULL) > 0) {
            read(signal_pipe[0], &byte, 1);
            printf("é€šè¿‡ç®¡é“æ£€æµ‹åˆ°ä¿¡å·\n");
        }
    }
    return 0;
}
```

### 8.5 ç«æ€æ¡ä»¶é¿å…


**âš ï¸ å…¸å‹ç«æ€æ¡ä»¶**
```c
// å±é™©çš„ä»£ç 
int main() {
    signal(SIGALRM, alarm_handler);
    alarm(1);
    pause();  // å¦‚æœä¿¡å·åœ¨alarm()å’Œpause()ä¹‹é—´åˆ°è¾¾ï¼Œç¨‹åºå¯èƒ½æ°¸ä¹…æŒ‚èµ·
    return 0;
}
```

**âœ… æ­£ç¡®çš„åšæ³•**
```c
int main() {
    sigset_t mask, old_mask;
    
    // å…ˆé˜»å¡SIGALRM
    sigemptyset(&mask);
    sigaddset(&mask, SIGALRM);
    sigprocmask(SIG_BLOCK, &mask, &old_mask);
    
    signal(SIGALRM, alarm_handler);
    alarm(1);
    
    // åŸå­æ€§åœ°è§£é™¤é˜»å¡å¹¶ç­‰å¾…
    sigsuspend(&old_mask);
    
    sigprocmask(SIG_SETMASK, &old_mask, NULL);
    return 0;
}
```

---

## 9. âš¡ å®æ—¶ä¿¡å·ä¸ä¿¡å·é˜Ÿåˆ—


### 9.1 å®æ—¶ä¿¡å·æ¦‚å¿µ


**ğŸ”¸ å®æ—¶ä¿¡å·èŒƒå›´**
- **ä¿¡å·ç¼–å·**ï¼šSIGRTMIN (34) åˆ° SIGRTMAX (64)
- **æ•°é‡**ï¼šé€šå¸¸æœ‰31ä¸ªå®æ—¶ä¿¡å·å¯ç”¨
- **ç‰¹ç‚¹**ï¼šè¿™äº›ä¿¡å·æ²¡æœ‰é¢„å®šä¹‰çš„å«ä¹‰ï¼Œå®Œå…¨ç”±åº”ç”¨ç¨‹åºå®šä¹‰

**ğŸ’¡ å®æ—¶ä¿¡å·ä¼˜åŠ¿**
```
ä¼ ç»Ÿä¿¡å·é—®é¢˜ï¼š
- ä¸æ’é˜Ÿï¼Œä¼šä¸¢å¤±
- ä¸èƒ½æºå¸¦æ•°æ®
- å¤„ç†é¡ºåºä¸ç¡®å®š

å®æ—¶ä¿¡å·è§£å†³ï¼š
- æ”¯æŒæ’é˜Ÿï¼Œä¸ä¼šä¸¢å¤±
- å¯ä»¥æºå¸¦æ•°æ®ï¼ˆintæˆ–æŒ‡é’ˆï¼‰
- æŒ‰å‘é€é¡ºåºå¤„ç†
- é«˜ä¼˜å…ˆçº§ä¿¡å·å…ˆå¤„ç†
```

### 9.2 å®æ—¶ä¿¡å·å‘é€


**ğŸ”¸ sigqueue()å‡½æ•°**
```c
#include <signal.h>
int sigqueue(pid_t pid, int sig, const union sigval value);
```

**ğŸ“Š sigvalè”åˆä½“**
```c
union sigval {
    int sival_int;      // æ•´æ•°æ•°æ®
    void *sival_ptr;    // æŒ‡é’ˆæ•°æ®
};
```

**ğŸ¯ å‘é€å®æ—¶ä¿¡å·ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

int main() {
    pid_t target_pid;
    union sigval value;
    
    printf("è¾“å…¥ç›®æ ‡è¿›ç¨‹PID: ");
    scanf("%d", &target_pid);
    
    // å‘é€æºå¸¦æ•´æ•°æ•°æ®çš„å®æ—¶ä¿¡å·
    for (int i = 1; i <= 5; i++) {
        value.sival_int = i * 100;
        sigqueue(target_pid, SIGRTMIN, value);
        printf("å‘é€å®æ—¶ä¿¡å·ï¼Œæºå¸¦æ•°æ®: %d\n", value.sival_int);
        usleep(100000);
    }
    
    return 0;
}
```

### 9.3 å®æ—¶ä¿¡å·æ¥æ”¶


**ğŸ”¸ é«˜çº§ä¿¡å·å¤„ç†å‡½æ•°**
```c
void handler(int sig, siginfo_t *info, void *context) {
    // sig: ä¿¡å·ç¼–å·
    // info: ä¿¡å·è¯¦ç»†ä¿¡æ¯
    // context: ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆé€šå¸¸ä¸ä½¿ç”¨ï¼‰
}
```

**ğŸ“Š siginfo_tç»“æ„ä½“å…³é”®å­—æ®µ**
```c
typedef struct {
    int si_signo;       // ä¿¡å·ç¼–å·
    int si_code;        // ä¿¡å·æ¥æºä»£ç 
    pid_t si_pid;       // å‘é€è¿›ç¨‹PID
    uid_t si_uid;       // å‘é€è¿›ç¨‹UID
    union sigval si_value;  // æºå¸¦çš„æ•°æ®
    // ... å…¶ä»–å­—æ®µ
} siginfo_t;
```

**ğŸ¯ æ¥æ”¶å®æ—¶ä¿¡å·ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>
#include <string.h>

void realtime_handler(int sig, siginfo_t *info, void *context) {
    printf("æ”¶åˆ°å®æ—¶ä¿¡å· %d\n", sig);
    printf("æ¥è‡ªè¿›ç¨‹: %d\n", info->si_pid);
    printf("æºå¸¦æ•°æ®: %d\n", info->si_value.sival_int);
    printf("ä¿¡å·ä»£ç : %d\n", info->si_code);
    printf("-------------------\n");
}

int main() {
    struct sigaction sa;
    
    // è®¾ç½®ä¿¡å·å¤„ç†
    memset(&sa, 0, sizeof(sa));
    sa.sa_sigaction = realtime_handler;  // ä½¿ç”¨é«˜çº§å¤„ç†å‡½æ•°
    sa.sa_flags = SA_SIGINFO;            // å¯ç”¨siginfoåŠŸèƒ½
    
    // æ³¨å†Œæ‰€æœ‰å®æ—¶ä¿¡å·
    for (int sig = SIGRTMIN; sig <= SIGRTMAX; sig++) {
        sigaction(sig, &sa, NULL);
    }
    
    printf("è¿›ç¨‹PID: %d\n", getpid());
    printf("ç­‰å¾…å®æ—¶ä¿¡å·...\n");
    
    while(1) {
        pause();
    }
    return 0;
}
```

### 9.4 ä¿¡å·é˜Ÿåˆ—æœºåˆ¶


**ğŸ”¸ é˜Ÿåˆ—ç‰¹æ€§**
```
ä¼˜å…ˆçº§é¡ºåºï¼š
1. ä¼ ç»Ÿä¿¡å· (1-31) æŒ‰ç¼–å·å‡åº
2. å®æ—¶ä¿¡å· (SIGRTMIN-SIGRTMAX) æŒ‰ç¼–å·å‡åº
3. åŒç¼–å·å®æ—¶ä¿¡å·æŒ‰å‘é€é¡ºåº

é˜Ÿåˆ—é™åˆ¶ï¼š
- ç³»ç»Ÿçº§é™åˆ¶ï¼š/proc/sys/kernel/rtsig-max
- è¿›ç¨‹çº§é™åˆ¶ï¼šRLIMIT_SIGPENDING
- ç”¨æˆ·çº§é™åˆ¶ï¼šé€šå¸¸å‡ åƒä¸ªä¿¡å·
```

**ğŸ¯ é˜Ÿåˆ—æµ‹è¯•ç¤ºä¾‹**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>
#include <sys/resource.h>

void queue_handler(int sig, siginfo_t *info, void *context) {
    static int count = 0;
    printf("å¤„ç†ç¬¬ %d ä¸ªå®æ—¶ä¿¡å·ï¼Œæ•°æ®: %d\n", 
           ++count, info->si_value.sival_int);
}

int main() {
    struct sigaction sa;
    struct rlimit rlim;
    
    // æŸ¥çœ‹ä¿¡å·é˜Ÿåˆ—é™åˆ¶
    getrlimit(RLIMIT_SIGPENDING, &rlim);
    printf("ä¿¡å·é˜Ÿåˆ—é™åˆ¶: %ld\n", rlim.rlim_cur);
    
    // è®¾ç½®å¤„ç†å‡½æ•°
    sa.sa_sigaction = queue_handler;
    sa.sa_flags = SA_SIGINFO;
    sigemptyset(&sa.sa_mask);
    sigaction(SIGRTMIN, &sa, NULL);
    
    // å‘è‡ªå·±å‘é€å¤šä¸ªä¿¡å·æµ‹è¯•é˜Ÿåˆ—
    union sigval value;
    for (int i = 1; i <= 10; i++) {
        value.sival_int = i;
        sigqueue(getpid(), SIGRTMIN, value);
    }
    
    // å¤„ç†æ‰€æœ‰æ’é˜Ÿçš„ä¿¡å·
    while(1) {
        pause();
    }
    return 0;
}
```

### 9.5 å®æ—¶ä¿¡å·åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹åº”ç”¨**
- **å¼‚æ­¥I/Oé€šçŸ¥**ï¼šæ–‡ä»¶æ“ä½œå®Œæˆé€šçŸ¥
- **å®šæ—¶å™¨**ï¼šé«˜ç²¾åº¦å®šæ—¶å™¨å®ç°
- **è¿›ç¨‹é—´æ•°æ®ä¼ é€’**ï¼šå°é‡æ•°æ®çš„å¿«é€Ÿä¼ é€’
- **äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ**ï¼šäº‹ä»¶é€šçŸ¥æœºåˆ¶

**ğŸ’¡ å®é™…ä½¿ç”¨å»ºè®®**
```c
// å®šä¹‰è‡ªå·±çš„å®æ—¶ä¿¡å·
#define MY_SIGNAL_DATA    (SIGRTMIN + 0)
#define MY_SIGNAL_TIMER   (SIGRTMIN + 1)
#define MY_SIGNAL_EVENT   (SIGRTMIN + 2)

// ä½¿ç”¨å®æ—¶ä¿¡å·ä¼ é€’äº‹ä»¶ID
void send_event(pid_t pid, int event_id) {
    union sigval value;
    value.sival_int = event_id;
    sigqueue(pid, MY_SIGNAL_EVENT, value);
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ä¿¡å·æœ¬è´¨ï¼šå¼‚æ­¥é€šä¿¡æœºåˆ¶ï¼Œè½¯ä»¶ä¸­æ–­
ğŸ”¸ ä¿¡å·ç”Ÿå‘½å‘¨æœŸï¼šç”Ÿæˆ â†’ å¾…å†³ â†’ é€’è¾¾ä¸‰ä¸ªé˜¶æ®µ
ğŸ”¸ ä¿¡å·åˆ†ç±»ï¼šæ ‡å‡†ä¿¡å·(1-31)å’Œå®æ—¶ä¿¡å·(34-64)
ğŸ”¸ å¤„ç†æ–¹å¼ï¼šé»˜è®¤å¤„ç†ã€å¿½ç•¥ã€è‡ªå®šä¹‰å¤„ç†å‡½æ•°
ğŸ”¸ ä¿¡å·æ©ç ï¼šæ§åˆ¶ä¿¡å·çš„é˜»å¡å’Œè§£é™¤é˜»å¡
ğŸ”¸ å®‰å…¨æ€§ï¼šä¿¡å·å¤„ç†å‡½æ•°çš„é‡å…¥æ€§å’Œå¼‚æ­¥å®‰å…¨
```

### 10.2 å…³é”®å‡½æ•°å¯¹æ¯”


| åŠŸèƒ½ç±»åˆ« | **ç®€å•æ–¹å¼** | **é«˜çº§æ–¹å¼** | **æ¨èä½¿ç”¨** |
|---------|-------------|-------------|-------------|
| **ä¿¡å·æ³¨å†Œ** | `signal()` | `sigaction()` | `sigaction()` |
| **ä¿¡å·å‘é€** | `kill()` | `sigqueue()` | `æ ¹æ®éœ€æ±‚é€‰æ‹©` |
| **ä¿¡å·ç­‰å¾…** | `pause()` | `sigsuspend()` | `sigsuspend()` |
| **ä¿¡å·æ©ç ** | `æ— ` | `sigprocmask()` | `sigprocmask()` |

### 10.3 é‡è¦ç†è§£è¦ç‚¹


**ğŸ”¹ ä¿¡å·çš„å¼‚æ­¥æ€§**
```
å…³é”®ç†è§£ï¼š
- ä¿¡å·éšæ—¶å¯èƒ½åˆ°è¾¾ï¼Œä¸­æ–­æ­£å¸¸æ‰§è¡Œ
- ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œåœ¨ä¿¡å·ä¸Šä¸‹æ–‡ä¸­
- éœ€è¦è€ƒè™‘é‡å…¥æ€§å’Œç«æ€æ¡ä»¶é—®é¢˜
```

**ğŸ”¹ å¯é ä¿¡å·vsä¸å¯é ä¿¡å·**
```
å®é™…å½±å“ï¼š
- ä¸å¯é ä¿¡å·å¯èƒ½ä¸¢å¤±ï¼Œé€‚åˆç®€å•é€šçŸ¥
- å¯é ä¿¡å·æ”¯æŒæ’é˜Ÿå’Œæ•°æ®ä¼ é€’ï¼Œé€‚åˆç²¾ç¡®æ§åˆ¶
- é€‰æ‹©ä¾æ®ï¼šä¸šåŠ¡å¯¹ä¿¡å·å¯é æ€§çš„è¦æ±‚
```

**ğŸ”¹ ä¿¡å·å¤„ç†å®‰å…¨æ€§**
```
å®‰å…¨åŸåˆ™ï¼š
- ä¿¡å·å¤„ç†å‡½æ•°è¦ç®€çŸ­ã€å¿«é€Ÿ
- åªä½¿ç”¨å¼‚æ­¥å®‰å…¨å‡½æ•°
- é¿å…å¤æ‚é€»è¾‘ï¼Œè®¾ç½®æ ‡å¿—ä½ååœ¨ä¸»ç¨‹åºå¤„ç†
- è€ƒè™‘ä½¿ç”¨è‡ªç®¡é“ç­‰æŠ€å·§
```

### 10.4 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… é€‚ç”¨åœºæ™¯**
- **è¿›ç¨‹æ§åˆ¶**ï¼šå¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡è¿›ç¨‹
- **å¼‚æ­¥é€šçŸ¥**ï¼šå­è¿›ç¨‹çŠ¶æ€å˜åŒ–ã€å®šæ—¶å™¨åˆ°æœŸ
- **ç”¨æˆ·äº¤äº’**ï¼šå“åº”ç”¨æˆ·çš„ä¸­æ–­è¯·æ±‚
- **é”™è¯¯å¤„ç†**ï¼šæ•è·ç¨‹åºå¼‚å¸¸ï¼Œä¼˜é›…é€€å‡º

**âŒ ä¸é€‚ç”¨åœºæ™¯**
- **å¤§é‡æ•°æ®ä¼ é€’**ï¼šä¿¡å·ä¸é€‚åˆä¼ é€’å¤æ‚æ•°æ®
- **é¢‘ç¹é€šä¿¡**ï¼šä¿¡å·å¼€é”€è¾ƒå¤§ï¼Œä¸é€‚åˆé«˜é¢‘é€šä¿¡
- **å¯é æ€§è¦æ±‚æé«˜**ï¼šè€ƒè™‘ä½¿ç”¨å…¶ä»–IPCæœºåˆ¶

**ğŸ”§ è°ƒè¯•æŠ€å·§**
```bash
# æŸ¥çœ‹è¿›ç¨‹ä¿¡å·çŠ¶æ€
cat /proc/PID/status | grep Sig

# å‘è¿›ç¨‹å‘é€ä¿¡å·æµ‹è¯•
kill -USR1 PID
kill -TERM PID

# æŸ¥çœ‹ä¿¡å·é˜Ÿåˆ—é™åˆ¶
ulimit -i
```

### 10.5 æœ€ä½³å®è·µæ€»ç»“


**ğŸ¯ è®¾è®¡åŸåˆ™**
1. **æœ€å°åŒ–ä¿¡å·å¤„ç†å‡½æ•°**ï¼šåªè®¾ç½®æ ‡å¿—ä½ï¼Œä¸»ç¨‹åºæ£€æŸ¥å¤„ç†
2. **åˆç†ä½¿ç”¨ä¿¡å·æ©ç **ï¼šé¿å…å…³é”®æ“ä½œè¢«ä¿¡å·ä¸­æ–­
3. **é€‰æ‹©åˆé€‚çš„ä¿¡å·ç±»å‹**ï¼šæ ¹æ®å¯é æ€§éœ€æ±‚é€‰æ‹©
4. **è€ƒè™‘ç§»æ¤æ€§**ï¼šä¼˜å…ˆä½¿ç”¨POSIXæ ‡å‡†å‡½æ•°
5. **å……åˆ†æµ‹è¯•**ï¼šä¿¡å·å¤„ç†çš„æ—¶åºé—®é¢˜éœ€è¦åå¤æµ‹è¯•

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ä¿¡å·å¼‚æ­¥è¦å°å¿ƒï¼Œå¤„ç†å‡½æ•°è¦ç®€æ´
- æ©ç é˜»å¡å·§è¿ç”¨ï¼Œç«æ€æ¡ä»¶éœ€é¿å…  
- å¯é ä¸å¯é è¦åˆ†æ¸…ï¼Œå®æ—¶ä¿¡å·åŠŸèƒ½å¼º
- å®‰å…¨å‡½æ•°æ˜¯å…³é”®ï¼Œè°ƒè¯•æµ‹è¯•ä¸å¯å°‘