---
title: 15ã€é”™è¯¯å¤„ç†ä¸è°ƒè¯•æŠ€æœ¯
---
## ğŸ“š ç›®å½•

1. [errnoå…¨å±€é”™è¯¯ç æœºåˆ¶](#1-errnoå…¨å±€é”™è¯¯ç æœºåˆ¶)
2. [é”™è¯¯ä¿¡æ¯è¾“å‡ºå‡½æ•°](#2-é”™è¯¯ä¿¡æ¯è¾“å‡ºå‡½æ•°)
3. [ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†æœ€ä½³å®è·µ](#3-ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†æœ€ä½³å®è·µ)
4. [gdbè°ƒè¯•ç³»ç»Ÿè°ƒç”¨ä¸å¤šçº¿ç¨‹](#4-gdbè°ƒè¯•ç³»ç»Ÿè°ƒç”¨ä¸å¤šçº¿ç¨‹)
5. [valgrindå†…å­˜é”™è¯¯æ£€æµ‹](#5-valgrindå†…å­˜é”™è¯¯æ£€æµ‹)
6. [straceç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªåˆ†æ](#6-straceç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªåˆ†æ)
7. [æ ¸å¿ƒè½¬å‚¨core dumpåˆ†æ](#7-æ ¸å¿ƒè½¬å‚¨core-dumpåˆ†æ)
8. [ç¨‹åºå¼‚å¸¸å¤„ç†ä¸æ¢å¤ç­–ç•¥](#8-ç¨‹åºå¼‚å¸¸å¤„ç†ä¸æ¢å¤ç­–ç•¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”¢ errnoå…¨å±€é”™è¯¯ç æœºåˆ¶


### 1.1 errnoçš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯errnoï¼Ÿ**
`errno` æ˜¯Linuxç³»ç»Ÿä¸­çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä¸“é—¨ç”¨æ¥è®°å½•ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°æ‰§è¡Œå¤±è´¥æ—¶çš„é”™è¯¯åŸå› ã€‚å¯ä»¥æŠŠå®ƒç†è§£ä¸ºç³»ç»Ÿçš„"é”™è¯¯è®°å½•æœ¬"ã€‚

**ğŸ”¸ errnoçš„å·¥ä½œåŸç†**
```
ç¨‹åºè°ƒç”¨ç³»ç»Ÿå‡½æ•°
        â†“
å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™
        â†“
ç³»ç»Ÿè‡ªåŠ¨è®¾ç½®errnoå€¼
        â†“
ç¨‹åºæ£€æŸ¥errnoäº†è§£é”™è¯¯åŸå› 
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦errnoï¼Ÿ**
- ç³»ç»Ÿè°ƒç”¨å¤±è´¥æ—¶ï¼Œé€šå¸¸åªè¿”å› `-1` è¡¨ç¤ºå‡ºé”™
- ä½†å¤±è´¥çš„åŸå› æœ‰å¾ˆå¤šç§ï¼šæ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™ä¸å¤Ÿã€å†…å­˜ä¸è¶³ç­‰
- errno å°±æ˜¯ç”¨æ¥å‘Šè¯‰æˆ‘ä»¬å…·ä½“æ˜¯ä»€ä¹ˆé”™è¯¯

### 1.2 errnoçš„åŸºæœ¬ä½¿ç”¨


**åŸºç¡€ç”¨æ³•ç¤ºä¾‹ï¼š**
```c
#include <stdio.h>
#include <errno.h>
#include <fcntl.h>

int main() {
    int fd = open("ä¸å­˜åœ¨çš„æ–‡ä»¶.txt", O_RDONLY);
    
    if (fd == -1) {
        printf("æ–‡ä»¶æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯ç : %d\n", errno);
        // è¾“å‡ºç±»ä¼¼ï¼šæ–‡ä»¶æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯ç : 2
    }
    
    return 0;
}
```

### 1.3 å¸¸è§errnoé”™è¯¯ç 


| é”™è¯¯ç  | å®å®šä¹‰ | å«ä¹‰ | å¸¸è§åœºæ™¯ |
|--------|--------|------|----------|
| **1** | `EPERM` | æ“ä½œä¸è¢«å…è®¸ | æƒé™ä¸è¶³ |
| **2** | `ENOENT` | æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨ | æ‰“å¼€ä¸å­˜åœ¨çš„æ–‡ä»¶ |
| **3** | `ESRCH` | è¿›ç¨‹ä¸å­˜åœ¨ | killä¸å­˜åœ¨çš„è¿›ç¨‹ |
| **4** | `EINTR` | ç³»ç»Ÿè°ƒç”¨è¢«ä¿¡å·ä¸­æ–­ | è¢«ä¿¡å·æ‰“æ–­çš„read |
| **5** | `EIO` | è¾“å…¥/è¾“å‡ºé”™è¯¯ | ç¡¬ä»¶è¯»å†™é”™è¯¯ |
| **11** | `EAGAIN` | èµ„æºæš‚æ—¶ä¸å¯ç”¨ | éé˜»å¡æ“ä½œéœ€è¦é‡è¯• |
| **12** | `ENOMEM` | å†…å­˜ä¸è¶³ | mallocå¤±è´¥ |
| **13** | `EACCES` | æƒé™è¢«æ‹’ç» | æ— è¯»å†™æƒé™ |

### 1.4 errnoä½¿ç”¨æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦æé†’ï¼š**
```
1. errnoåªåœ¨å‡½æ•°å¤±è´¥æ—¶æ‰æœ‰æ„ä¹‰
2. æˆåŠŸçš„ç³»ç»Ÿè°ƒç”¨ä¸ä¼šæ¸…é›¶errno
3. errnoæ˜¯çº¿ç¨‹å±€éƒ¨çš„ï¼ˆæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„errnoï¼‰
4. è°ƒç”¨ä»»ä½•å¯èƒ½ä¿®æ”¹errnoçš„å‡½æ•°å‰ï¼Œè¦å…ˆä¿å­˜errnoå€¼
```

**é”™è¯¯çš„ä½¿ç”¨æ–¹å¼ï¼š**
```c
// âŒ é”™è¯¯åšæ³•
int fd = open("file.txt", O_RDONLY);
printf("æ‰“å¼€æ–‡ä»¶...\n");  // printfå¯èƒ½ä¿®æ”¹errno
if (fd == -1) {
    printf("é”™è¯¯ç : %d\n", errno);  // è¿™é‡Œçš„errnoå¯èƒ½ä¸å‡†ç¡®
}
```

**æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼ï¼š**
```c
// âœ… æ­£ç¡®åšæ³•
int fd = open("file.txt", O_RDONLY);
if (fd == -1) {
    int saved_errno = errno;  // ç«‹å³ä¿å­˜
    printf("æ–‡ä»¶æ‰“å¼€å¤±è´¥\n");
    printf("é”™è¯¯ç : %d\n", saved_errno);
}
```

---

## 2. ğŸ“¢ é”™è¯¯ä¿¡æ¯è¾“å‡ºå‡½æ•°


### 2.1 perror() - ç®€å•é”™è¯¯è¾“å‡º


**perror()çš„ä½œç”¨**
`perror()` æ˜¯æœ€ç®€å•çš„é”™è¯¯è¾“å‡ºå‡½æ•°ï¼Œå®ƒä¼šï¼š
1. è¾“å‡ºä½ æä¾›çš„é”™è¯¯æç¤ºä¿¡æ¯
2. è‡ªåŠ¨æ ¹æ®å½“å‰errnoå€¼è¾“å‡ºå¯¹åº”çš„é”™è¯¯æè¿°

**åŸºæœ¬è¯­æ³•ï¼š**
```c
#include <stdio.h>
void perror(const char *s);
```

**å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼š**
```c
#include <stdio.h>
#include <fcntl.h>

int main() {
    int fd = open("ä¸å­˜åœ¨æ–‡ä»¶.txt", O_RDONLY);
    
    if (fd == -1) {
        perror("æ‰“å¼€æ–‡ä»¶å¤±è´¥");
        // è¾“å‡ºï¼šæ‰“å¼€æ–‡ä»¶å¤±è´¥: No such file or directory
    }
    
    return 0;
}
```

### 2.2 strerror() - çµæ´»é”™è¯¯æè¿°


**strerror()çš„ä¼˜åŠ¿**
ç›¸æ¯”perror()ï¼Œ`strerror()` æ›´çµæ´»ï¼š
- å¯ä»¥è·å–ä»»æ„é”™è¯¯ç çš„æè¿°
- è¿”å›å­—ç¬¦ä¸²ï¼Œå¯ä»¥è‡ªç”±ç»„åˆé”™è¯¯ä¿¡æ¯
- æ”¯æŒè‡ªå®šä¹‰é”™è¯¯è¾“å‡ºæ ¼å¼

**åŸºæœ¬ç”¨æ³•ï¼š**
```c
#include <string.h>
#include <errno.h>

int main() {
    int fd = open("ä¸å­˜åœ¨æ–‡ä»¶.txt", O_RDONLY);
    
    if (fd == -1) {
        printf("é”™è¯¯ï¼š%s (é”™è¯¯ç : %d)\n", 
               strerror(errno), errno);
        // è¾“å‡ºï¼šé”™è¯¯ï¼šNo such file or directory (é”™è¯¯ç : 2)
    }
    
    return 0;
}
```

**é«˜çº§ç”¨æ³• - è‡ªå®šä¹‰é”™è¯¯æ ¼å¼ï¼š**
```c
#include <stdio.h>
#include <string.h>
#include <errno.h>
#include <time.h>

void log_error(const char *operation) {
    time_t now;
    time(&now);
    
    printf("[%s] %s å¤±è´¥: %s\n", 
           ctime(&now), operation, strerror(errno));
}

int main() {
    int fd = open("test.txt", O_RDONLY);
    if (fd == -1) {
        log_error("æ‰“å¼€æ–‡ä»¶");
        // è¾“å‡ºï¼š[Mon Jan 21 10:30:00 2025] æ‰“å¼€æ–‡ä»¶ å¤±è´¥: No such file or directory
    }
    
    return 0;
}
```

### 2.3 ä¸¤ç§å‡½æ•°çš„å¯¹æ¯”


| ç‰¹æ€§ | **perror()** | **strerror()** |
|------|-------------|---------------|
| **ä½¿ç”¨éš¾åº¦** | ç®€å•ï¼Œä¸€è¡Œæå®š | éœ€è¦ç»„åˆprintf |
| **çµæ´»æ€§** | å›ºå®šæ ¼å¼è¾“å‡º | è‡ªç”±ç»„åˆæ ¼å¼ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•é”™è¯¯æç¤º | å¤æ‚æ—¥å¿—ç³»ç»Ÿ |
| **çº¿ç¨‹å®‰å…¨** | æ˜¯ | å¦ï¼ˆéœ€è¦strerror_rï¼‰ |

---

## 3. âœ… ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†æœ€ä½³å®è·µ


### 3.1 æ ‡å‡†é”™è¯¯å¤„ç†æ¨¡å¼


**åŸºæœ¬æ¨¡å¼ï¼šæ£€æŸ¥è¿”å›å€¼ + å¤„ç†é”™è¯¯**
```c
// æ–‡ä»¶æ“ä½œé”™è¯¯å¤„ç†
int safe_open(const char *filename, int flags) {
    int fd = open(filename, flags);
    if (fd == -1) {
        fprintf(stderr, "æ— æ³•æ‰“å¼€æ–‡ä»¶ %s: %s\n", 
                filename, strerror(errno));
        return -1;
    }
    return fd;
}

// å†…å­˜åˆ†é…é”™è¯¯å¤„ç†
void* safe_malloc(size_t size) {
    void *ptr = malloc(size);
    if (ptr == NULL) {
        fprintf(stderr, "å†…å­˜åˆ†é…å¤±è´¥: %s\n", strerror(errno));
        exit(EXIT_FAILURE);
    }
    return ptr;
}
```

### 3.2 EINTRä¿¡å·ä¸­æ–­å¤„ç†


**ä»€ä¹ˆæ˜¯EINTRï¼Ÿ**
å½“ç³»ç»Ÿè°ƒç”¨æ‰§è¡ŒæœŸé—´è¢«ä¿¡å·ä¸­æ–­æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨ä¼šè¿”å›`-1`å¹¶è®¾ç½®`errno = EINTR`ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦é‡æ–°æ‰§è¡Œè¢«ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨ã€‚

**ä¿¡å·ä¸­æ–­å®‰å…¨çš„read()ï¼š**
```c
ssize_t safe_read(int fd, void *buf, size_t count) {
    ssize_t result;
    
    do {
        result = read(fd, buf, count);
    } while (result == -1 && errno == EINTR);
    
    return result;
}
```

**ä¿¡å·ä¸­æ–­å®‰å…¨çš„write()ï¼š**
```c
ssize_t safe_write(int fd, const void *buf, size_t count) {
    ssize_t written = 0;
    ssize_t result;
    
    while (written < count) {
        result = write(fd, (char*)buf + written, count - written);
        
        if (result == -1) {
            if (errno == EINTR) {
                continue;  // è¢«ä¿¡å·ä¸­æ–­ï¼Œé‡è¯•
            }
            return -1;  // çœŸæ­£çš„é”™è¯¯
        }
        
        written += result;
    }
    
    return written;
}
```

### 3.3 èµ„æºæ¸…ç†ä¸é”™è¯¯æ¢å¤


**RAIIé£æ ¼çš„èµ„æºç®¡ç†ï¼š**
```c
typedef struct {
    int fd;
    FILE *file;
    void *buffer;
} resource_t;

// èµ„æºåˆå§‹åŒ–
resource_t* resource_init() {
    resource_t *res = malloc(sizeof(resource_t));
    if (!res) return NULL;
    
    res->fd = -1;
    res->file = NULL;
    res->buffer = NULL;
    
    return res;
}

// èµ„æºæ¸…ç†
void resource_cleanup(resource_t *res) {
    if (!res) return;
    
    if (res->fd != -1) {
        close(res->fd);
    }
    if (res->file) {
        fclose(res->file);
    }
    if (res->buffer) {
        free(res->buffer);
    }
    free(res);
}

// å¸¦é”™è¯¯å¤„ç†çš„å‡½æ•°ç¤ºä¾‹
int process_file(const char *filename) {
    resource_t *res = resource_init();
    if (!res) {
        return -1;
    }
    
    // æ‰“å¼€æ–‡ä»¶
    res->fd = open(filename, O_RDONLY);
    if (res->fd == -1) {
        perror("æ‰“å¼€æ–‡ä»¶å¤±è´¥");
        goto cleanup;
    }
    
    // åˆ†é…ç¼“å†²åŒº
    res->buffer = malloc(1024);
    if (!res->buffer) {
        perror("å†…å­˜åˆ†é…å¤±è´¥");
        goto cleanup;
    }
    
    // å¤„ç†æ–‡ä»¶...
    // æˆåŠŸå¤„ç†
    resource_cleanup(res);
    return 0;
    
cleanup:
    resource_cleanup(res);
    return -1;
}
```

---

## 4. ğŸ› gdbè°ƒè¯•ç³»ç»Ÿè°ƒç”¨ä¸å¤šçº¿ç¨‹


### 4.1 gdbåŸºç¡€è°ƒè¯•å‘½ä»¤


**å¯åŠ¨è°ƒè¯•ï¼š**
```bash
# ç¼–è¯‘æ—¶åŠ ä¸Šè°ƒè¯•ä¿¡æ¯
gcc -g -o myprogram myprogram.c

# å¯åŠ¨gdbè°ƒè¯•
gdb ./myprogram
```

**åŸºæœ¬è°ƒè¯•å‘½ä»¤é€ŸæŸ¥ï¼š**

| å‘½ä»¤ | ç®€å†™ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|------|
| `run` | `r` | è¿è¡Œç¨‹åº | `r arg1 arg2` |
| `break` | `b` | è®¾ç½®æ–­ç‚¹ | `b main` `b 25` |
| `continue` | `c` | ç»§ç»­æ‰§è¡Œ | `c` |
| `step` | `s` | å•æ­¥æ‰§è¡Œï¼ˆè¿›å…¥å‡½æ•°ï¼‰ | `s` |
| `next` | `n` | å•æ­¥æ‰§è¡Œï¼ˆä¸è¿›å…¥å‡½æ•°ï¼‰ | `n` |
| `print` | `p` | æ‰“å°å˜é‡å€¼ | `p errno` |
| `backtrace` | `bt` | æ˜¾ç¤ºè°ƒç”¨æ ˆ | `bt` |

### 4.2 è°ƒè¯•ç³»ç»Ÿè°ƒç”¨


**è®¾ç½®ç³»ç»Ÿè°ƒç”¨æ–­ç‚¹ï¼š**
```bash
(gdb) break open
(gdb) break read
(gdb) break write
```

**æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨å‚æ•°å’Œè¿”å›å€¼ï¼š**
```bash
# è¿è¡Œåˆ°openç³»ç»Ÿè°ƒç”¨æ—¶
(gdb) info args
filename = 0x... "test.txt"
flags = 0

# æŸ¥çœ‹è¿”å›å€¼
(gdb) finish
Value returned is $1 = -1

# æŸ¥çœ‹errno
(gdb) p errno
$2 = 2

# æŸ¥çœ‹errnoå¯¹åº”çš„é”™è¯¯ä¿¡æ¯
(gdb) p strerror(errno)
$3 = "No such file or directory"
```

### 4.3 å¤šçº¿ç¨‹ç¨‹åºè°ƒè¯•


**æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹ï¼š**
```bash
(gdb) info threads
  Id   Target Id         Frame 
* 1    Thread 0x7ffff7fc9740 (LWP 1234) "main" main () at main.c:10
  2    Thread 0x7ffff77c8700 (LWP 1235) "worker" worker_thread () at main.c:25
  3    Thread 0x7ffff6fc7700 (LWP 1236) "worker" worker_thread () at main.c:30
```

**åˆ‡æ¢åˆ°æŒ‡å®šçº¿ç¨‹ï¼š**
```bash
(gdb) thread 2
[Switching to thread 2 (Thread 0x7ffff77c8700 (LWP 1235))]

# æŸ¥çœ‹å½“å‰çº¿ç¨‹çš„è°ƒç”¨æ ˆ
(gdb) bt
```

**å¯¹æ‰€æœ‰çº¿ç¨‹åº”ç”¨å‘½ä»¤ï¼š**
```bash
# æ‰€æœ‰çº¿ç¨‹çš„è°ƒç”¨æ ˆ
(gdb) thread apply all bt

# æ‰€æœ‰çº¿ç¨‹ç»§ç»­æ‰§è¡Œ
(gdb) thread apply all continue
```

**è®¾ç½®çº¿ç¨‹ç‰¹å®šæ–­ç‚¹ï¼š**
```bash
# åªåœ¨çº¿ç¨‹2ä¸­çš„å‡½æ•°å¤„æ–­ç‚¹
(gdb) break worker_thread thread 2
```

### 4.4 gdbè°ƒè¯•æŠ€å·§


**ğŸ’¡ å®ç”¨è°ƒè¯•æŠ€å·§ï¼š**

**1. æ¡ä»¶æ–­ç‚¹**
```bash
# åªæœ‰å½“errnoç­‰äºç‰¹å®šå€¼æ—¶æ‰æ–­ç‚¹
(gdb) break error_handler if errno == 2
```

**2. ç›‘è§†å˜é‡**
```bash
# å½“å˜é‡å€¼æ”¹å˜æ—¶è‡ªåŠ¨æ–­ç‚¹
(gdb) watch global_counter
```

**3. è‡ªåŠ¨åŒ–è°ƒè¯•è„šæœ¬**
```bash
# åˆ›å»º.gdbinitæ–‡ä»¶ï¼Œè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤
set print pretty on
set logging on
break main
run
```

---

## 5. ğŸ” valgrindå†…å­˜é”™è¯¯æ£€æµ‹


### 5.1 valgrindåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯valgrindï¼Ÿ**
valgrindæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å†…å­˜è°ƒè¯•å·¥å…·ï¼Œå¯ä»¥æ£€æµ‹ï¼š
- å†…å­˜æ³„æ¼ï¼ˆæ²¡æœ‰é‡Šæ”¾çš„å†…å­˜ï¼‰
- ç¼“å†²åŒºæº¢å‡ºï¼ˆè¶Šç•Œè®¿é—®ï¼‰
- ä½¿ç”¨æœªåˆå§‹åŒ–çš„å†…å­˜
- é‡å¤é‡Šæ”¾å†…å­˜

**åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# å®‰è£…valgrind
sudo apt-get install valgrind

# æ£€æµ‹å†…å­˜é”™è¯¯
valgrind --tool=memcheck ./myprogram

# è¯¦ç»†è¾“å‡º
valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all ./myprogram
```

### 5.2 å¸¸è§å†…å­˜é”™è¯¯æ£€æµ‹


**ç¤ºä¾‹ç¨‹åºï¼ˆåŒ…å«å¤šç§å†…å­˜é”™è¯¯ï¼‰ï¼š**
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main() {
    // 1. å†…å­˜æ³„æ¼
    char *leak = malloc(100);
    // å¿˜è®°free(leak)
    
    // 2. ç¼“å†²åŒºæº¢å‡º
    char buffer[10];
    strcpy(buffer, "è¿™ä¸ªå­—ç¬¦ä¸²å¤ªé•¿äº†ä¼šæº¢å‡º");
    
    // 3. ä½¿ç”¨æœªåˆå§‹åŒ–å†…å­˜
    int *uninitialized = malloc(sizeof(int));
    printf("æœªåˆå§‹åŒ–çš„å€¼: %d\n", *uninitialized);
    
    // 4. é‡å¤é‡Šæ”¾
    char *ptr = malloc(50);
    free(ptr);
    free(ptr);  // é‡å¤é‡Šæ”¾
    
    return 0;
}
```

**valgrindè¾“å‡ºè§£è¯»ï¼š**
```bash
==1234== Memcheck, a memory error detector
==1234== 
==1234== Invalid write of size 1
==1234==    at 0x4C2E80F: strcpy (string3.h:107)
==1234==    at 0x400567: main (test.c:11)
==1234== Address 0x51f1050 is 0 bytes after a block of size 10 alloc'd
==1234==    ç¼“å†²åŒºæº¢å‡ºé”™è¯¯
==1234== 
==1234== Conditional jump or move depends on uninitialised value(s)
==1234==    at 0x4E7C9A0: printf (printf.c:35)
==1234==    at 0x40058A: main (test.c:15)
==1234==    ä½¿ç”¨æœªåˆå§‹åŒ–å†…å­˜
==1234== 
==1234== Invalid free() / delete / delete[] / realloc()
==1234==    at 0x4C2BDEC: free (vg_replace_malloc.c:530)
==1234==    at 0x4005A8: main (test.c:20)
==1234== Address 0x51f1080 is 0 bytes inside a block of size 50 free'd
==1234==    é‡å¤é‡Šæ”¾é”™è¯¯
```

### 5.3 valgrindé«˜çº§é€‰é¡¹


**è¯¦ç»†å†…å­˜æ³„æ¼æ£€æµ‹ï¼š**
```bash
valgrind --tool=memcheck \
         --leak-check=full \
         --show-leak-kinds=all \
         --track-origins=yes \
         ./myprogram
```

**æ€§èƒ½åˆ†æï¼š**
```bash
# æ€§èƒ½åˆ†æå·¥å…·
valgrind --tool=callgrind ./myprogram

# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
callgrind_annotate callgrind.out.1234
```

**ç¼“å­˜æ€§èƒ½åˆ†æï¼š**
```bash
valgrind --tool=cachegrind ./myprogram
```

---

## 6. ğŸ“Š straceç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªåˆ†æ


### 6.1 straceåŸºæœ¬ä½¿ç”¨


**ä»€ä¹ˆæ˜¯straceï¼Ÿ**
straceæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªå·¥å…·ï¼Œå¯ä»¥ï¼š
- ç›‘è§†ç¨‹åºè°ƒç”¨äº†å“ªäº›ç³»ç»Ÿè°ƒç”¨
- æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°å’Œè¿”å›å€¼
- åˆ†æç¨‹åºçš„ç³»ç»Ÿçº§è¡Œä¸º
- è¯Šæ–­ç¨‹åºå¡æ­»æˆ–æ€§èƒ½é—®é¢˜

**åŸºæœ¬ä½¿ç”¨è¯­æ³•ï¼š**
```bash
# è·Ÿè¸ªç¨‹åºçš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨
strace ./myprogram

# è·Ÿè¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹
strace -p 1234

# åªè·Ÿè¸ªç‰¹å®šçš„ç³»ç»Ÿè°ƒç”¨
strace -e open,read,write ./myprogram
```

### 6.2 straceè¾“å‡ºè§£è¯»


**ç¤ºä¾‹ç¨‹åºï¼š**
```c
#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>

int main() {
    int fd = open("test.txt", O_RDONLY);
    if (fd != -1) {
        char buffer[100];
        read(fd, buffer, sizeof(buffer));
        close(fd);
    }
    return 0;
}
```

**straceè¾“å‡ºç¤ºä¾‹ï¼š**
```bash
$ strace ./test_program

execve("./test_program", ["./test_program"], [/* 67 vars */]) = 0
# ç¨‹åºå¯åŠ¨

open("test.txt", O_RDONLY) = -1 ENOENT (No such file or directory)
# å°è¯•æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼Œæ–‡ä»¶ä¸å­˜åœ¨

exit_group(0) = ?
# ç¨‹åºæ­£å¸¸é€€å‡º
```

**è¾“å‡ºæ ¼å¼è§£é‡Šï¼š**
```
ç³»ç»Ÿè°ƒç”¨å(å‚æ•°1, å‚æ•°2, ...) = è¿”å›å€¼ é”™è¯¯ä¿¡æ¯
     â†“           â†“                  â†“        â†“
   open    ("test.txt", O_RDONLY)  = -1   ENOENT
```

### 6.3 straceé«˜çº§åŠŸèƒ½


**ç»Ÿè®¡ç³»ç»Ÿè°ƒç”¨ï¼š**
```bash
# æ˜¾ç¤ºç³»ç»Ÿè°ƒç”¨ç»Ÿè®¡ä¿¡æ¯
strace -c ./myprogram

# è¾“å‡ºç¤ºä¾‹ï¼š
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 30.00    0.000006           3         2           read
 20.00    0.000004           2         2           write
 15.00    0.000003           3         1         1 open
 10.00    0.000002           2         1           close
```

**è·Ÿè¸ªç‰¹å®šç³»ç»Ÿè°ƒç”¨ç»„ï¼š**
```bash
# åªè·Ÿè¸ªæ–‡ä»¶æ“ä½œ
strace -e trace=file ./myprogram

# åªè·Ÿè¸ªç½‘ç»œæ“ä½œ
strace -e trace=network ./myprogram

# åªè·Ÿè¸ªå†…å­˜æ“ä½œ
strace -e trace=memory ./myprogram
```

**ä¿å­˜è·Ÿè¸ªç»“æœï¼š**
```bash
# ä¿å­˜åˆ°æ–‡ä»¶
strace -o trace.log ./myprogram

# åŒ…å«æ—¶é—´æˆ³
strace -t -o trace.log ./myprogram

# è¯¦ç»†æ—¶é—´ä¿¡æ¯
strace -tt -T -o trace.log ./myprogram
```

### 6.4 straceå®ç”¨åœºæ™¯


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­ï¼š**

**1. ç¨‹åºå¯åŠ¨æ…¢**
```bash
strace -f -tt ./slow_program 2>&1 | grep -E "(open|stat|access)"
# æŸ¥çœ‹ç¨‹åºå¯åŠ¨æ—¶è®¿é—®äº†å“ªäº›æ–‡ä»¶
```

**2. ç¨‹åºå¡æ­»**
```bash
strace -p `pidof stuck_program`
# æŸ¥çœ‹å¡æ­»ç¨‹åºå½“å‰åœ¨ç­‰å¾…ä»€ä¹ˆç³»ç»Ÿè°ƒç”¨
```

**3. æ–‡ä»¶æƒé™é—®é¢˜**
```bash
strace -e trace=file ./myprogram 2>&1 | grep EACCES
# æŸ¥çœ‹æƒé™è¢«æ‹’ç»çš„æ–‡ä»¶æ“ä½œ
```

---

## 7. ğŸ’¥ æ ¸å¿ƒè½¬å‚¨core dumpåˆ†æ


### 7.1 ä»€ä¹ˆæ˜¯æ ¸å¿ƒè½¬å‚¨


**æ ¸å¿ƒè½¬å‚¨ï¼ˆCore Dumpï¼‰çš„æ¦‚å¿µï¼š**
å½“ç¨‹åºå› ä¸ºä¸¥é‡é”™è¯¯ï¼ˆå¦‚æ®µé”™è¯¯ã€é™¤é›¶é”™è¯¯ï¼‰å´©æºƒæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ç¨‹åºçš„å†…å­˜çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å°±å«æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚

**äº§ç”Ÿcore dumpçš„å¸¸è§åŸå› ï¼š**
- æ®µé”™è¯¯ï¼ˆè®¿é—®éæ³•å†…å­˜åœ°å€ï¼‰
- æµ®ç‚¹å¼‚å¸¸ï¼ˆé™¤é›¶é”™è¯¯ï¼‰
- éæ³•æŒ‡ä»¤
- æ€»çº¿é”™è¯¯

### 7.2 å¯ç”¨æ ¸å¿ƒè½¬å‚¨


**æ£€æŸ¥core dumpè®¾ç½®ï¼š**
```bash
# æŸ¥çœ‹å½“å‰coreæ–‡ä»¶å¤§å°é™åˆ¶
ulimit -c

# å¦‚æœæ˜¾ç¤º0ï¼Œè¯´æ˜ç¦ç”¨äº†core dump
# å¯ç”¨core dumpï¼ˆè®¾ç½®æ— é™åˆ¶ï¼‰
ulimit -c unlimited

# æŸ¥çœ‹coreæ–‡ä»¶ä¿å­˜è·¯å¾„
cat /proc/sys/kernel/core_pattern
# é€šå¸¸æ˜¾ç¤ºï¼šcore æˆ– |/usr/share/apport/apport %p %s %c %d %P
```

**æ°¸ä¹…å¯ç”¨core dumpï¼š**
```bash
# åœ¨~/.bashrcä¸­æ·»åŠ 
echo "ulimit -c unlimited" >> ~/.bashrc
```

### 7.3 ç”Ÿæˆå’Œåˆ†æcore dump


**ç¤ºä¾‹å´©æºƒç¨‹åºï¼š**
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
    int *ptr = NULL;
    *ptr = 42;  // æ®µé”™è¯¯ï¼šè®¿é—®ç©ºæŒ‡é’ˆ
    return 0;
}
```

**ç¼–è¯‘å’Œè¿è¡Œï¼š**
```bash
# ç¼–è¯‘æ—¶åŒ…å«è°ƒè¯•ä¿¡æ¯
gcc -g -o crash_test crash_test.c

# è¿è¡Œç¨‹åºï¼ˆä¼šäº§ç”Ÿæ®µé”™è¯¯ï¼‰
./crash_test
# è¾“å‡ºï¼šSegmentation fault (core dumped)

# æŸ¥çœ‹ç”Ÿæˆçš„coreæ–‡ä»¶
ls -la core*
```

**ä½¿ç”¨gdbåˆ†æcore dumpï¼š**
```bash
# ä½¿ç”¨gdbåŠ è½½ç¨‹åºå’Œcoreæ–‡ä»¶
gdb ./crash_test core

# åœ¨gdbä¸­æŸ¥çœ‹å´©æºƒä¿¡æ¯
(gdb) bt
#0  0x0000555555555149 in main () at crash_test.c:6

(gdb) list
1    #include <stdio.h>
2    #include <stdlib.h>
3    
4    int main() {
5        int *ptr = NULL;
6        *ptr = 42;  // æ®µé”™è¯¯ï¼šè®¿é—®ç©ºæŒ‡é’ˆ
7        return 0;
8    }

(gdb) p ptr
$1 = (int *) 0x0

(gdb) info registers
# æŸ¥çœ‹å¯„å­˜å™¨çŠ¶æ€
```

### 7.4 é«˜çº§core dumpåˆ†æ


**åˆ†æå¤æ‚çš„å´©æºƒï¼š**
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void buggy_function(char *input) {
    char buffer[10];
    strcpy(buffer, input);  // ç¼“å†²åŒºæº¢å‡º
    printf("å¤„ç†å®Œæˆ: %s\n", buffer);
}

int main() {
    char *long_string = "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡º";
    buggy_function(long_string);
    return 0;
}
```

**gdbåˆ†ææ­¥éª¤ï¼š**
```bash
(gdb) bt
#0  0x00007ffff7a52428 in __GI_raise (sig=6) at ../sysdeps/unix/sysv/linux/raise.c:54
#1  0x00007ffff7a5402a in __GI_abort () at abort.c:89
#2  0x00007ffff7a947ea in __libc_message (do_abort=2, fmt=0x7ffff7baf8d8 "*** %s ***: %s terminated\n") 
#3  0x00007ffff7b36f56 in __GI___fortify_fail (msg=0x7ffff7baf8ba "buffer overflow detected") 
#4  0x00007ffff7b35110 in __GI___chk_fail () at chk_fail.c:28
#5  0x00007ffff7b344b8 in __strcpy_chk (dest=0x7fffffffe1ae "", src=0x555555555004 "è¿™æ˜¯ä¸€ä¸ª...", destlen=10)
#6  0x0000555555555187 in buggy_function (input=0x555555555004 "è¿™æ˜¯ä¸€ä¸ª...") at buffer_overflow.c:6
#7  0x00005555555551b1 in main () at buffer_overflow.c:12

# å¯ä»¥çœ‹åˆ°æ˜¯strcpyå¯¼è‡´çš„ç¼“å†²åŒºæº¢å‡º
(gdb) frame 6
(gdb) list
(gdb) p input
(gdb) p buffer
```

---

## 8. ğŸ›¡ï¸ ç¨‹åºå¼‚å¸¸å¤„ç†ä¸æ¢å¤ç­–ç•¥


### 8.1 ä¿¡å·å¤„ç†æœºåˆ¶


**ä¿¡å·çš„åŸºæœ¬æ¦‚å¿µï¼š**
ä¿¡å·æ˜¯Linuxç³»ç»Ÿä¸­è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æœºåˆ¶ï¼Œä¹Ÿæ˜¯ç³»ç»Ÿé€šçŸ¥ç¨‹åºå‘ç”Ÿå¼‚å¸¸çš„æ–¹å¼ã€‚

**å¸¸è§ä¿¡å·ç±»å‹ï¼š**

| ä¿¡å· | æ•°å€¼ | å«ä¹‰ | é»˜è®¤è¡Œä¸º |
|------|------|------|----------|
| `SIGINT` | 2 | ä¸­æ–­ä¿¡å·ï¼ˆCtrl+Cï¼‰ | ç»ˆæ­¢ç¨‹åº |
| `SIGQUIT` | 3 | é€€å‡ºä¿¡å·ï¼ˆCtrl+\\ï¼‰ | ç»ˆæ­¢å¹¶ç”Ÿæˆcore |
| `SIGKILL` | 9 | å¼ºåˆ¶ç»ˆæ­¢ | ç«‹å³ç»ˆæ­¢ï¼ˆä¸å¯æ•è·ï¼‰ |
| `SIGSEGV` | 11 | æ®µé”™è¯¯ | ç»ˆæ­¢å¹¶ç”Ÿæˆcore |
| `SIGTERM` | 15 | ä¼˜é›…ç»ˆæ­¢è¯·æ±‚ | ç»ˆæ­¢ç¨‹åº |
| `SIGUSR1` | 10 | ç”¨æˆ·å®šä¹‰ä¿¡å·1 | ç»ˆæ­¢ç¨‹åº |

### 8.2 ä¿¡å·å¤„ç†å‡½æ•°


**åŸºæœ¬ä¿¡å·å¤„ç†ï¼š**
```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

// ä¿¡å·å¤„ç†å‡½æ•°
void signal_handler(int signum) {
    switch(signum) {
        case SIGINT:
            printf("\næ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œç¨‹åºå³å°†é€€å‡º...\n");
            exit(0);
            break;
        case SIGUSR1:
            printf("æ”¶åˆ°ç”¨æˆ·å®šä¹‰ä¿¡å·1\n");
            break;
        default:
            printf("æ”¶åˆ°ä¿¡å·: %d\n", signum);
    }
}

int main() {
    // æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°
    signal(SIGINT, signal_handler);
    signal(SIGUSR1, signal_handler);
    
    printf("ç¨‹åºè¿è¡Œä¸­ï¼ŒPID: %d\n", getpid());
    printf("å‘é€ kill -USR1 %d æµ‹è¯•ç”¨æˆ·ä¿¡å·\n", getpid());
    
    // æ— é™å¾ªç¯ç­‰å¾…ä¿¡å·
    while(1) {
        sleep(1);
        printf(".");
        fflush(stdout);
    }
    
    return 0;
}
```

### 8.3 é«˜çº§ä¿¡å·å¤„ç† - sigaction


**sigactionçš„ä¼˜åŠ¿ï¼š**
- æ›´ç²¾ç¡®çš„ä¿¡å·æ§åˆ¶
- å¯ä»¥è·å–ä¿¡å·çš„è¯¦ç»†ä¿¡æ¯
- æ›´å¥½çš„å¯ç§»æ¤æ€§

```c
#include <stdio.h>
#include <signal.h>
#include <string.h>

void advanced_signal_handler(int signum, siginfo_t *info, void *context) {
    printf("æ”¶åˆ°ä¿¡å· %d\n", signum);
    printf("å‘é€è€…PID: %d\n", info->si_pid);
    printf("ä¿¡å·ä»£ç : %d\n", info->si_code);
    
    if (signum == SIGSEGV) {
        printf("æ®µé”™è¯¯åœ°å€: %p\n", info->si_addr);
        // è¿™é‡Œå¯ä»¥åšä¸€äº›æ¸…ç†å·¥ä½œ
        printf("ç¨‹åºå³å°†é€€å‡º...\n");
        exit(1);
    }
}

int main() {
    struct sigaction sa;
    
    // è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°
    sa.sa_sigaction = advanced_signal_handler;
    sa.sa_flags = SA_SIGINFO;  // ä½¿ç”¨æ‰©å±•ä¿¡æ¯
    sigemptyset(&sa.sa_mask);
    
    // æ³¨å†Œå¤šä¸ªä¿¡å·
    sigaction(SIGINT, &sa, NULL);
    sigaction(SIGSEGV, &sa, NULL);
    sigaction(SIGUSR1, &sa, NULL);
    
    printf("é«˜çº§ä¿¡å·å¤„ç†ç¨‹åºå¯åŠ¨\n");
    
    // æ•…æ„äº§ç”Ÿæ®µé”™è¯¯è¿›è¡Œæµ‹è¯•
    // int *p = NULL;
    // *p = 42;
    
    while(1) {
        sleep(1);
    }
    
    return 0;
}
```

### 8.4 å¼‚å¸¸æ¢å¤ç­–ç•¥


**èµ„æºä¿æŠ¤å’Œæ¢å¤ï¼š**
```c
#include <stdio.h>
#include <signal.h>
#include <setjmp.h>

// ä¿å­˜ç¨‹åºçŠ¶æ€çš„è·³è½¬ç¼“å†²åŒº
jmp_buf recovery_point;

// å…¨å±€èµ„æºæŒ‡é’ˆ
FILE *log_file = NULL;
int *shared_memory = NULL;

// æ¸…ç†å‡½æ•°
void cleanup_resources() {
    if (log_file) {
        fprintf(log_file, "ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œè¿›è¡Œèµ„æºæ¸…ç†\n");
        fclose(log_file);
        log_file = NULL;
    }
    
    if (shared_memory) {
        free(shared_memory);
        shared_memory = NULL;
    }
    
    printf("èµ„æºæ¸…ç†å®Œæˆ\n");
}

// ä¿¡å·å¤„ç†å‡½æ•°
void emergency_handler(int signum) {
    printf("æ”¶åˆ°ç´§æ€¥ä¿¡å· %dï¼Œå¯åŠ¨æ¢å¤ç¨‹åº\n", signum);
    
    // æ¸…ç†èµ„æº
    cleanup_resources();
    
    if (signum == SIGSEGV) {
        printf("æ®µé”™è¯¯æ¢å¤ï¼Œè·³è½¬åˆ°å®‰å…¨ç‚¹\n");
        longjmp(recovery_point, 1);  // è·³è½¬åˆ°å®‰å…¨ç‚¹
    } else {
        exit(1);
    }
}

int risky_operation() {
    printf("æ‰§è¡Œå±é™©æ“ä½œ...\n");
    
    // æ¨¡æ‹Ÿå¯èƒ½å‡ºé”™çš„æ“ä½œ
    int *ptr = NULL;
    *ptr = 42;  // è¿™ä¼šè§¦å‘æ®µé”™è¯¯
    
    return 0;
}

int main() {
    // è®¾ç½®ä¿¡å·å¤„ç†
    signal(SIGSEGV, emergency_handler);
    signal(SIGINT, emergency_handler);
    
    // æ‰“å¼€æ—¥å¿—æ–‡ä»¶
    log_file = fopen("program.log", "w");
    if (!log_file) {
        perror("æ— æ³•æ‰“å¼€æ—¥å¿—æ–‡ä»¶");
        return 1;
    }
    
    // åˆ†é…å†…å­˜
    shared_memory = malloc(1024);
    if (!shared_memory) {
        perror("å†…å­˜åˆ†é…å¤±è´¥");
        fclose(log_file);
        return 1;
    }
    
    // è®¾ç½®æ¢å¤ç‚¹
    if (setjmp(recovery_point) == 0) {
        // æ­£å¸¸æ‰§è¡Œè·¯å¾„
        fprintf(log_file, "ç¨‹åºæ­£å¸¸å¯åŠ¨\n");
        risky_operation();  // è¿™ä¼šè§¦å‘æ®µé”™è¯¯
    } else {
        // å¼‚å¸¸æ¢å¤è·¯å¾„
        printf("ä»å¼‚å¸¸ä¸­æ¢å¤ï¼Œç¨‹åºç»§ç»­è¿è¡Œ\n");
        fprintf(stderr, "æ“ä½œå¤±è´¥ï¼Œä½†ç¨‹åºå·²æ¢å¤\n");
    }
    
    // æ­£å¸¸æ¸…ç†
    cleanup_resources();
    printf("ç¨‹åºæ­£å¸¸ç»“æŸ\n");
    
    return 0;
}
```

**ğŸ’¡ å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µï¼š**

1. **é¢„é˜²æ€§ç¼–ç¨‹**ï¼šåœ¨å¯èƒ½å‡ºé”™çš„åœ°æ–¹æå‰æ£€æŸ¥
2. **åˆ†å±‚é”™è¯¯å¤„ç†**ï¼šä¸åŒå±‚æ¬¡ä½¿ç”¨ä¸åŒçš„é”™è¯¯å¤„ç†ç­–ç•¥
3. **èµ„æºç®¡ç†**ï¼šç¡®ä¿å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿèƒ½æ­£ç¡®é‡Šæ”¾èµ„æº
4. **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†è®°å½•é”™è¯¯ä¿¡æ¯ä¾¿äºè°ƒè¯•
5. **ä¼˜é›…é€€å‡º**ï¼šç»™ç¨‹åºæ—¶é—´è¿›è¡Œæ¸…ç†å·¥ä½œ

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ errnoæœºåˆ¶ï¼šå…¨å±€é”™è¯¯ç ç³»ç»Ÿï¼Œè®°å½•ç³»ç»Ÿè°ƒç”¨å¤±è´¥åŸå› 
ğŸ”¸ é”™è¯¯è¾“å‡ºï¼šperror()ç®€å•è¾“å‡ºï¼Œstrerror()çµæ´»ç»„åˆ
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šæ£€æŸ¥è¿”å›å€¼ã€å¤„ç†EINTRã€èµ„æºæ¸…ç†
ğŸ”¸ gdbè°ƒè¯•ï¼šæ–­ç‚¹ã€å•æ­¥ã€å¤šçº¿ç¨‹è°ƒè¯•æŠ€å·§
ğŸ”¸ valgrindï¼šå†…å­˜é”™è¯¯æ£€æµ‹çš„å¿…å¤‡å·¥å…·
ğŸ”¸ straceï¼šç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªåˆ†æç¨‹åºè¡Œä¸º
ğŸ”¸ core dumpï¼šç¨‹åºå´©æºƒåçš„å†…å­˜å¿«ç…§åˆ†æ
ğŸ”¸ ä¿¡å·å¤„ç†ï¼šå¼‚å¸¸æƒ…å†µä¸‹çš„ç¨‹åºæ¢å¤ç­–ç•¥
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é”™è¯¯å¤„ç†çš„å±‚æ¬¡æ€§**
```
ç³»ç»Ÿçº§é”™è¯¯ï¼šerrno + ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼
åº“å‡½æ•°é”™è¯¯ï¼šç‰¹å®šçš„é”™è¯¯ç å’Œå¤„ç†æ–¹å¼
åº”ç”¨çº§é”™è¯¯ï¼šä¸šåŠ¡é€»è¾‘çš„é”™è¯¯å¤„ç†
```

**ğŸ”¹ è°ƒè¯•å·¥å…·çš„é€‰æ‹©**
```
é™æ€é—®é¢˜ï¼šç¼–è¯‘å™¨è­¦å‘Š + ä»£ç å®¡æŸ¥
è¿è¡Œæ—¶é”™è¯¯ï¼šgdb + valgrind
ç³»ç»Ÿçº§é—®é¢˜ï¼šstrace + core dumpåˆ†æ
æ€§èƒ½é—®é¢˜ï¼šprofilingå·¥å…· + ç³»ç»Ÿç›‘æ§
```

**ğŸ”¹ å¼‚å¸¸å¤„ç†çš„å¹³è¡¡**
```
å¯é æ€§ vs æ€§èƒ½ï¼šé”™è¯¯æ£€æŸ¥çš„å¼€é”€
ç®€å•æ€§ vs å¥å£®æ€§ï¼šé”™è¯¯å¤„ç†çš„å¤æ‚åº¦
æ¢å¤ vs é€€å‡ºï¼šå¼‚å¸¸æƒ…å†µä¸‹çš„ç­–ç•¥é€‰æ‹©
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ—¥å¸¸å¼€å‘å»ºè®®ï¼š**

**ç¼–ç é˜¶æ®µï¼š**
- æ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½è¦æ£€æŸ¥è¿”å›å€¼
- ä½¿ç”¨å·¥å…·å‡½æ•°å°è£…å¸¸è§çš„é”™è¯¯å¤„ç†æ¨¡å¼
- ä¸ºå…³é”®èµ„æºå®ç°RAIIé£æ ¼ç®¡ç†

**æµ‹è¯•é˜¶æ®µï¼š**
- ä½¿ç”¨valgrindæ£€æµ‹å†…å­˜é—®é¢˜
- ç”¨straceåˆ†æç¨‹åºçš„ç³»ç»Ÿè¡Œä¸º
- æ¨¡æ‹Ÿå„ç§é”™è¯¯æƒ…å†µæµ‹è¯•ç¨‹åºå¥å£®æ€§

**è°ƒè¯•é˜¶æ®µï¼š**
- å¯ç”¨core dumpæ”¶é›†å´©æºƒä¿¡æ¯
- ä½¿ç”¨gdbè¿›è¡Œäº¤äº’å¼è°ƒè¯•
- ç»“åˆå¤šç§å·¥å…·å®šä½é—®é¢˜æ ¹æº

**éƒ¨ç½²é˜¶æ®µï¼š**
- å®ç°å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿ
- è®¾ç½®ä¿¡å·å¤„ç†ä¿è¯ä¼˜é›…é€€å‡º
- å»ºç«‹ç›‘æ§æœºåˆ¶åŠæ—¶å‘ç°é—®é¢˜

### 9.4 å·¥å…·ä½¿ç”¨æŠ€å·§æ€»ç»“


| å·¥å…· | **ä¸»è¦ç”¨é€”** | **ä½¿ç”¨æ—¶æœº** | **æ³¨æ„äº‹é¡¹** |
|------|-------------|-------------|-------------|
| **errno/perror** | åŸºç¡€é”™è¯¯å¤„ç† | æ¯ä¸ªç³»ç»Ÿè°ƒç”¨å | åŠæ—¶ä¿å­˜errnoå€¼ |
| **gdb** | äº¤äº’å¼è°ƒè¯• | é€»è¾‘é”™è¯¯ã€å´©æºƒåˆ†æ | ç¼–è¯‘æ—¶åŠ -gé€‰é¡¹ |
| **valgrind** | å†…å­˜é”™è¯¯æ£€æµ‹ | å¼€å‘å’Œæµ‹è¯•é˜¶æ®µ | ç¨‹åºè¿è¡Œå˜æ…¢æ˜¯æ­£å¸¸çš„ |
| **strace** | ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ª | æ€§èƒ½åˆ†æã€è¡Œä¸ºè¯Šæ–­ | è¾“å‡ºé‡å¤§ï¼Œéœ€è¦è¿‡æ»¤ |
| **core dump** | å´©æºƒååˆ†æ | ç¨‹åºå´©æºƒå | éœ€è¦å¯ç”¨core dump |

**æ ¸å¿ƒè®°å¿†è¦ç‚¹ï¼š**
- é”™è¯¯å¤„ç†æ˜¯ç³»ç»Ÿç¼–ç¨‹çš„åŸºæœ¬åŠŸï¼Œæ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½è¦æ£€æŸ¥
- è°ƒè¯•å·¥å…·å„æœ‰ä¸“é•¿ï¼Œç»„åˆä½¿ç”¨æ•ˆæœæœ€å¥½
- é¢„é˜²æ€§ç¼–ç¨‹æ¯”äº‹åè°ƒè¯•æ›´é‡è¦
- å¼‚å¸¸å¤„ç†è¦è€ƒè™‘èµ„æºæ¸…ç†å’Œç¨‹åºæ¢å¤