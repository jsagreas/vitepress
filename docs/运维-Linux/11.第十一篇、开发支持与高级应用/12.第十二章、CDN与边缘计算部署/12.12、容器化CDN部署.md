---
title: 12ã€å®¹å™¨åŒ–CDNéƒ¨ç½²
---
## ğŸ“š ç›®å½•

1. [å®¹å™¨åŒ–CDNåŸºç¡€æ¦‚å¿µ](#1-å®¹å™¨åŒ–CDNåŸºç¡€æ¦‚å¿µ)
2. [Docker CDNé•œåƒæ„å»º](#2-Docker-CDNé•œåƒæ„å»º)
3. [Kubernetes CDNé›†ç¾¤éƒ¨ç½²](#3-Kubernetes-CDNé›†ç¾¤éƒ¨ç½²)
4. [å®¹å™¨åŒ–ç¼“å­˜å­˜å‚¨æ–¹æ¡ˆ](#4-å®¹å™¨åŒ–ç¼“å­˜å­˜å‚¨æ–¹æ¡ˆ)
5. [æœåŠ¡å‘ç°ä¸é…ç½®ç®¡ç†](#5-æœåŠ¡å‘ç°ä¸é…ç½®ç®¡ç†)
6. [å¼¹æ€§ä¼¸ç¼©ä¸æ»šåŠ¨æ›´æ–°](#6-å¼¹æ€§ä¼¸ç¼©ä¸æ»šåŠ¨æ›´æ–°)
7. [ç½‘ç»œä¸å­˜å‚¨é…ç½®](#7-ç½‘ç»œä¸å­˜å‚¨é…ç½®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å®¹å™¨åŒ–CDNåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å®¹å™¨åŒ–CDN


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
å®¹å™¨åŒ–CDNå°±æ˜¯æŠŠä¼ ç»Ÿçš„CDNæœåŠ¡æ‰“åŒ…åˆ°Dockerå®¹å™¨é‡Œè¿è¡Œã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä»¥å‰CDNæœåŠ¡éœ€è¦åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šå®‰è£…å„ç§è½¯ä»¶ï¼Œç°åœ¨æˆ‘ä»¬æŠŠè¿™äº›æœåŠ¡è¿åŒè¿è¡Œç¯å¢ƒä¸€èµ·æ‰“åŒ…æˆä¸€ä¸ª"ç›’å­"ï¼Œè¿™ä¸ªç›’å­å°±æ˜¯å®¹å™¨ã€‚

```
ä¼ ç»ŸCDNéƒ¨ç½²ï¼š
æœåŠ¡å™¨ + æ“ä½œç³»ç»Ÿ + Nginx + é…ç½®æ–‡ä»¶ + ç¼“å­˜å­˜å‚¨

å®¹å™¨åŒ–CDNéƒ¨ç½²ï¼š
Dockerå®¹å™¨[Nginx + é…ç½® + è¿è¡Œç¯å¢ƒ] + å¤–éƒ¨å­˜å‚¨
```

**ğŸ”¸ æ ¸å¿ƒä¼˜åŠ¿å¯¹æ¯”**

| ä¼ ç»ŸCDNéƒ¨ç½² | **å®¹å™¨åŒ–CDNéƒ¨ç½²** | **å®é™…å¥½å¤„** |
|------------|-----------------|-------------|
| `æ‰‹åŠ¨å®‰è£…é…ç½®` | `ä¸€é”®éƒ¨ç½²` | `éƒ¨ç½²æ—¶é—´ä»å°æ—¶å‡å°‘åˆ°åˆ†é’Ÿ` |
| `ç¯å¢ƒä¾èµ–å¤æ‚` | `ç¯å¢ƒä¸€è‡´æ€§` | `å¼€å‘æµ‹è¯•ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´` |
| `æ‰©å®¹å›°éš¾` | `ç§’çº§æ‰©å®¹` | `æµé‡é«˜å³°æ—¶å¿«é€Ÿå“åº”` |
| `æ›´æ–°é£é™©é«˜` | `æ»šåŠ¨æ›´æ–°` | `é›¶åœæœºæ—¶é—´æ›´æ–°æœåŠ¡` |

### 1.2 å®¹å™¨åŒ–CDNæ¶æ„å›¾


```
                    è´Ÿè½½å‡è¡¡å™¨
                        |
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |           |           |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CDNå®¹å™¨1    â”‚ â”‚ CDNå®¹å™¨2    â”‚ â”‚ CDNå®¹å™¨3    â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ Nginx   â”‚ â”‚ â”‚ â”‚ Nginx   â”‚ â”‚ â”‚ â”‚ Nginx   â”‚ â”‚
    â”‚ â”‚ ç¼“å­˜æœåŠ¡ â”‚ â”‚ â”‚ â”‚ ç¼“å­˜æœåŠ¡ â”‚ â”‚ â”‚ â”‚ ç¼“å­˜æœåŠ¡ â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |           |           |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    |                   |                   |
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å…±äº«ç¼“å­˜1â”‚      â”‚å…±äº«ç¼“å­˜2â”‚       â”‚å…±äº«ç¼“å­˜3â”‚
â”‚(Redis)  â”‚      â”‚(Redis)  â”‚       â”‚(Redis)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ä¸ºä»€ä¹ˆè¦å®¹å™¨åŒ–CDN


**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

**é—®é¢˜1ï¼šéƒ¨ç½²å¤æ‚æ€§**
- **ä¼ ç»Ÿæ–¹å¼**ï¼šéœ€è¦åœ¨æ¯å°æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨å®‰è£…Nginxã€é…ç½®æ–‡ä»¶ã€ä¾èµ–åº“
- **å®¹å™¨åŒ–æ–¹å¼**ï¼šä¸€æ¬¡æ„å»ºï¼Œåˆ°å¤„è¿è¡Œï¼Œæ‰€æœ‰ä¾èµ–éƒ½åœ¨å®¹å™¨å†…

**é—®é¢˜2ï¼šç¯å¢ƒä¸€è‡´æ€§**
- **ä¼ ç»Ÿæ–¹å¼**ï¼šå¼€å‘ç¯å¢ƒUbuntuï¼Œæµ‹è¯•ç¯å¢ƒCentOSï¼Œç”Ÿäº§ç¯å¢ƒRHELï¼Œå¯èƒ½å‡ºç°å…¼å®¹é—®é¢˜
- **å®¹å™¨åŒ–æ–¹å¼**ï¼šæ‰€æœ‰ç¯å¢ƒè¿è¡Œç›¸åŒçš„å®¹å™¨é•œåƒ

**é—®é¢˜3ï¼šæ‰©å®¹é€Ÿåº¦**
- **ä¼ ç»Ÿæ–¹å¼**ï¼šæ–°å¢èŠ‚ç‚¹éœ€è¦å‡ å°æ—¶é…ç½®
- **å®¹å™¨åŒ–æ–¹å¼**ï¼šå‡ åˆ†é’Ÿå†…å¯åŠ¨æ–°å®¹å™¨

> ğŸ’¡ **é€šä¿—ç†è§£**  
> å®¹å™¨åŒ–CDNå°±åƒæ ‡å‡†åŒ–çš„é›†è£…ç®±è¿è¾“ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆè´§ç‰©ï¼ˆCDNæœåŠ¡ï¼‰ï¼Œéƒ½ç”¨ç»Ÿä¸€è§„æ ¼çš„é›†è£…ç®±ï¼ˆDockerå®¹å™¨ï¼‰æ¥è£…è½½å’Œè¿è¾“ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡å’Œæ ‡å‡†åŒ–ç¨‹åº¦ã€‚

---

## 2. ğŸ³ Docker CDNé•œåƒæ„å»º


### 2.1 é•œåƒæ„å»ºåŸºç¡€


**ğŸ”¸ ä»€ä¹ˆæ˜¯Dockeré•œåƒ**
Dockeré•œåƒå°±åƒä¸€ä¸ª"æ¨¡æ¿"ï¼ŒåŒ…å«äº†è¿è¡ŒCDNæœåŠ¡æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ã€‚æƒ³è±¡æˆä¸€ä¸ªUç›˜ï¼Œé‡Œé¢æœ‰å®Œæ•´çš„CDNè½¯ä»¶å’Œé…ç½®ï¼Œæ’åˆ°ä»»ä½•æ”¯æŒDockerçš„æœåŠ¡å™¨ä¸Šéƒ½èƒ½ç›´æ¥è¿è¡Œã€‚

**ğŸ”¸ CDNé•œåƒçš„æ ¸å¿ƒç»„æˆ**
```
CDN Dockeré•œåƒå†…å®¹ï¼š
â”œâ”€â”€ åŸºç¡€æ“ä½œç³»ç»Ÿ (Alpine Linux)
â”œâ”€â”€ Nginx WebæœåŠ¡å™¨
â”œâ”€â”€ ç¼“å­˜æ¨¡å— (nginx-cache-purge)
â”œâ”€â”€ é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ å¯åŠ¨è„šæœ¬
â””â”€â”€ ç›‘æ§ç»„ä»¶
```

### 2.2 CDNé•œåƒæ„å»ºå®è·µ


**ğŸ”§ Dockerfileç¼–å†™ç¤ºä¾‹**

```dockerfile
# ä½¿ç”¨è½»é‡çº§åŸºç¡€é•œåƒ
FROM nginx:alpine

# è®¾ç½®ç»´æŠ¤è€…ä¿¡æ¯
LABEL maintainer="cdn-team@company.com"

# å®‰è£…å¿…è¦å·¥å…·å’Œç¼“å­˜æ¨¡å—
RUN apk add --no-cache \
    curl \
    bash \
    nginx-mod-http-cache-purge

# å¤åˆ¶é…ç½®æ–‡ä»¶
COPY nginx.conf /etc/nginx/nginx.conf
COPY default.conf /etc/nginx/conf.d/default.conf

# åˆ›å»ºç¼“å­˜ç›®å½•
RUN mkdir -p /var/cache/nginx/cdn && \
    chown -R nginx:nginx /var/cache/nginx

# å¤åˆ¶å¯åŠ¨è„šæœ¬
COPY start.sh /start.sh
RUN chmod +x /start.sh

# æš´éœ²ç«¯å£
EXPOSE 80 443

# è®¾ç½®å¯åŠ¨å‘½ä»¤
CMD ["/start.sh"]
```

**ğŸ”§ Nginxé…ç½®æ–‡ä»¶ (nginx.conf)**

```nginx
user nginx;
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    # ç¼“å­˜é…ç½®
    proxy_cache_path /var/cache/nginx/cdn 
                     levels=1:2 
                     keys_zone=cdn_cache:100m 
                     max_size=10g 
                     inactive=60m;
    
    # åŸºç¡€é…ç½®
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # æ—¥å¿—æ ¼å¼
    log_format cdn_log '$remote_addr - $remote_user [$time_local] '
                       '"$request" $status $body_bytes_sent '
                       '"$http_referer" "$http_user_agent" '
                       'cache:$upstream_cache_status';
    
    # å¼•å…¥ç«™ç‚¹é…ç½®
    include /etc/nginx/conf.d/*.conf;
}
```

### 2.3 é•œåƒæ„å»ºä¸ä¼˜åŒ–


**ğŸš€ æ„å»ºå‘½ä»¤**
```bash
# æ„å»ºé•œåƒ
docker build -t my-cdn:v1.0 .

# æŸ¥çœ‹é•œåƒå¤§å°
docker images my-cdn:v1.0

# è¿è¡Œæµ‹è¯•
docker run -d -p 80:80 --name test-cdn my-cdn:v1.0
```

**âš¡ é•œåƒä¼˜åŒ–æŠ€å·§**

| ä¼˜åŒ–æ–¹æ³• | **å…·ä½“åšæ³•** | **æ•ˆæœ** |
|---------|------------|---------|
| `å¤šé˜¶æ®µæ„å»º` | `ç¼–è¯‘å’Œè¿è¡Œåˆ†ç¦»` | `é•œåƒå¤§å°å‡å°‘60%` |
| `AlpineåŸºç¡€é•œåƒ` | `ä½¿ç”¨è½»é‡çº§Linux` | `æ¯”Ubuntuå°90%` |
| `æ¸…ç†ç¼“å­˜` | `åˆ é™¤åŒ…ç®¡ç†å™¨ç¼“å­˜` | `å‡å°‘10-20MB` |
| `åˆå¹¶RUNæŒ‡ä»¤` | `å‡å°‘é•œåƒå±‚æ•°` | `æå‡æ„å»ºé€Ÿåº¦` |

**ğŸ”§ ä¼˜åŒ–åçš„Dockerfile**
```dockerfile
FROM nginx:alpine AS builder

# å®‰è£…æ„å»ºå·¥å…·
RUN apk add --no-cache --virtual .build-deps \
    gcc \
    make \
    && apk add --no-cache nginx-mod-http-cache-purge \
    && apk del .build-deps

# ç”Ÿäº§é•œåƒ
FROM nginx:alpine
COPY --from=builder /usr/lib/nginx/modules/ /usr/lib/nginx/modules/
# ... å…¶ä»–é…ç½®
```

---

## 3. â˜¸ï¸ Kubernetes CDNé›†ç¾¤éƒ¨ç½²


### 3.1 KubernetesåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯Kubernetes**
Kubernetesï¼ˆç®€ç§°K8sï¼‰æ˜¯å®¹å™¨ç¼–æ’å¹³å°ï¼Œå¯ä»¥ç†è§£ä¸º"å®¹å™¨ç®¡å®¶"ã€‚å¦‚æœDockerå®¹å™¨æ˜¯é›†è£…ç®±ï¼Œé‚£ä¹ˆKuberneteså°±æ˜¯æ¸¯å£è°ƒåº¦ç³»ç»Ÿï¼Œè´Ÿè´£å†³å®šå“ªä¸ªé›†è£…ç®±æ”¾åœ¨å“ªä¸ªä½ç½®ï¼Œä»€ä¹ˆæ—¶å€™è£…å¸ã€‚

**ğŸ”¸ CDNé›†ç¾¤æ ¸å¿ƒç»„ä»¶**
```
Kubernetes CDNé›†ç¾¤æ¶æ„ï¼š

MasterèŠ‚ç‚¹ï¼ˆå¤§è„‘ï¼‰
â”œâ”€â”€ API Serverï¼ˆæ¥æ”¶æŒ‡ä»¤ï¼‰
â”œâ”€â”€ Controller Managerï¼ˆä¿æŒæœŸæœ›çŠ¶æ€ï¼‰
â”œâ”€â”€ Schedulerï¼ˆå†³å®šå®¹å™¨æ”¾å“ªé‡Œï¼‰
â””â”€â”€ etcdï¼ˆå­˜å‚¨é›†ç¾¤ä¿¡æ¯ï¼‰

WorkerèŠ‚ç‚¹ï¼ˆå¹²æ´»çš„ï¼‰
â”œâ”€â”€ kubeletï¼ˆæ‰§è¡Œä»»åŠ¡çš„ä»£ç†ï¼‰
â”œâ”€â”€ CDN Podï¼ˆå®é™…çš„CDNå®¹å™¨ï¼‰
â””â”€â”€ kube-proxyï¼ˆç½‘ç»œä»£ç†ï¼‰
```

### 3.2 CDNæœåŠ¡éƒ¨ç½²é…ç½®


**ğŸ”§ CDN Deploymenté…ç½®**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cdn-deployment
  labels:
    app: cdn
spec:
  replicas: 3  # è¿è¡Œ3ä¸ªCDNå®ä¾‹
  selector:
    matchLabels:
      app: cdn
  template:
    metadata:
      labels:
        app: cdn
    spec:
      containers:
      - name: cdn-server
        image: my-cdn:v1.0
        ports:
        - containerPort: 80
        - containerPort: 443
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        volumeMounts:
        - name: cache-storage
          mountPath: /var/cache/nginx
      volumes:
      - name: cache-storage
        emptyDir:
          sizeLimit: 1Gi
```

**ğŸ”§ Serviceè´Ÿè½½å‡è¡¡é…ç½®**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: cdn-service
spec:
  selector:
    app: cdn
  ports:
  - name: http
    port: 80
    targetPort: 80
  - name: https
    port: 443
    targetPort: 443
  type: LoadBalancer
```

### 3.3 é›†ç¾¤éƒ¨ç½²æ“ä½œæµç¨‹


**ğŸ“‹ éƒ¨ç½²æ­¥éª¤**

1ï¸âƒ£ **å‡†å¤‡é•œåƒ**
```bash
# æ¨é€é•œåƒåˆ°ä»“åº“
docker tag my-cdn:v1.0 registry.company.com/cdn:v1.0
docker push registry.company.com/cdn:v1.0
```

2ï¸âƒ£ **åˆ›å»ºå‘½åç©ºé—´**
```bash
kubectl create namespace cdn-system
```

3ï¸âƒ£ **éƒ¨ç½²CDNæœåŠ¡**
```bash
kubectl apply -f cdn-deployment.yaml -n cdn-system
kubectl apply -f cdn-service.yaml -n cdn-system
```

4ï¸âƒ£ **éªŒè¯éƒ¨ç½²**
```bash
# æŸ¥çœ‹PodçŠ¶æ€
kubectl get pods -n cdn-system

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
kubectl get svc -n cdn-system

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
kubectl describe deployment cdn-deployment -n cdn-system
```

**ğŸ” çŠ¶æ€æ£€æŸ¥æ–¹æ³•**

| æ£€æŸ¥é¡¹ç›® | **å‘½ä»¤** | **æœŸæœ›ç»“æœ** |
|---------|---------|-------------|
| `Podè¿è¡ŒçŠ¶æ€` | `kubectl get pods` | `RunningçŠ¶æ€` |
| `æœåŠ¡ç«¯ç‚¹` | `kubectl get endpoints` | `æœ‰å¯ç”¨IPåœ°å€` |
| `èµ„æºä½¿ç”¨` | `kubectl top pods` | `åœ¨é™åˆ¶èŒƒå›´å†…` |
| `æ—¥å¿—æ£€æŸ¥` | `kubectl logs pod-name` | `æ— é”™è¯¯ä¿¡æ¯` |

---

## 4. ğŸ’¾ å®¹å™¨åŒ–ç¼“å­˜å­˜å‚¨æ–¹æ¡ˆ


### 4.1 ç¼“å­˜å­˜å‚¨åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ç¼“å­˜çš„ä½œç”¨**
CDNç¼“å­˜å°±åƒä¾¿åˆ©åº—ï¼ŒæŠŠç”¨æˆ·ç»å¸¸éœ€è¦çš„å•†å“ï¼ˆç½‘ç«™å†…å®¹ï¼‰æ”¾åœ¨ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°æ–¹ï¼Œç”¨æˆ·è¦ä¹°ä¸œè¥¿ä¸ç”¨è·‘åˆ°è¿œå¤„çš„å¤§è¶…å¸‚ï¼ˆæºæœåŠ¡å™¨ï¼‰ï¼Œç›´æ¥åœ¨ä¾¿åˆ©åº—å°±èƒ½ä¹°åˆ°ã€‚

**ğŸ”¸ å®¹å™¨åŒ–ç¼“å­˜æŒ‘æˆ˜**
```
ä¼ ç»Ÿç¼“å­˜ï¼š
æ–‡ä»¶å­˜å‚¨åœ¨æœåŠ¡å™¨ç¡¬ç›˜ â†’ é‡å¯åæ•°æ®è¿˜åœ¨

å®¹å™¨åŒ–ç¼“å­˜ï¼š
æ–‡ä»¶å­˜å‚¨åœ¨å®¹å™¨å†… â†’ å®¹å™¨é‡å¯æ•°æ®ä¸¢å¤±ï¼

è§£å†³æ–¹æ¡ˆï¼š
ä½¿ç”¨å¤–éƒ¨å­˜å‚¨ â†’ æ•°æ®æŒä¹…åŒ–ä¿å­˜
```

### 4.2 ç¼“å­˜å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”


**ğŸ“Š å­˜å‚¨æ–¹æ¡ˆé€‰æ‹©**

| å­˜å‚¨ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **æ€§èƒ½** |
|---------|------------|---------|---------|---------|
| `å†…å­˜ç¼“å­˜` | `çƒ­ç‚¹å†…å®¹` | `é€Ÿåº¦æå¿«` | `å®¹é‡æœ‰é™ï¼Œæ˜“ä¸¢å¤±` | `â­â­â­â­â­` |
| `æœ¬åœ°SSD` | `ä¸­ç­‰çƒ­åº¦å†…å®¹` | `é€Ÿåº¦å¿«ï¼Œæˆæœ¬ä½` | `èŠ‚ç‚¹æ•…éšœæ•°æ®ä¸¢å¤±` | `â­â­â­â­` |
| `ç½‘ç»œå­˜å‚¨` | `æŒä¹…åŒ–ç¼“å­˜` | `æ•°æ®å®‰å…¨ï¼Œå…±äº«` | `ç½‘ç»œå»¶è¿Ÿ` | `â­â­â­` |
| `åˆ†å¸ƒå¼å­˜å‚¨` | `å¤§è§„æ¨¡é›†ç¾¤` | `é«˜å¯ç”¨ï¼Œå¯æ‰©å±•` | `å¤æ‚åº¦é«˜` | `â­â­â­â­` |

### 4.3 Redisåˆ†å¸ƒå¼ç¼“å­˜éƒ¨ç½²


**ğŸ”§ Redisé›†ç¾¤é…ç½®**

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: redis-cache
spec:
  replicas: 3
  serviceName: redis-cache
  selector:
    matchLabels:
      app: redis-cache
  template:
    metadata:
      labels:
        app: redis-cache
    spec:
      containers:
      - name: redis
        image: redis:alpine
        ports:
        - containerPort: 6379
        volumeMounts:
        - name: redis-data
          mountPath: /data
        command:
        - redis-server
        - --appendonly yes
        - --maxmemory 1gb
        - --maxmemory-policy allkeys-lru
  volumeClaimTemplates:
  - metadata:
      name: redis-data
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 10Gi
```

**ğŸ”§ CDNè¿æ¥Redisé…ç½®**

```nginx
http {
    # Redisè¿æ¥é…ç½®
    upstream redis_backend {
        server redis-cache-0.redis-cache:6379;
        server redis-cache-1.redis-cache:6379;
        server redis-cache-2.redis-cache:6379;
    }
    
    server {
        location / {
            # å…ˆæ£€æŸ¥Redisç¼“å­˜
            set $key $scheme$host$request_uri;
            redis2_query get $key;
            redis2_pass redis_backend;
            
            # ç¼“å­˜æœªå‘½ä¸­æ—¶ä»£ç†åˆ°åç«¯
            proxy_pass http://backend;
            
            # ç¼“å­˜å“åº”åˆ°Redis
            redis2_query setex $key 3600 $upstream_response_body;
        }
    }
}
```

### 4.4 å­˜å‚¨æŒä¹…åŒ–ç­–ç•¥


**ğŸ”¸ æŒä¹…å·é…ç½®**

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: cdn-cache-pv
spec:
  capacity:
    storage: 100Gi
  accessModes:
  - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: fast-ssd
  hostPath:
    path: /data/cdn-cache
```

**ğŸ”¸ ç¼“å­˜æ¸…ç†ç­–ç•¥**

| æ¸…ç†ç­–ç•¥ | **è§¦å‘æ¡ä»¶** | **æ¸…ç†èŒƒå›´** | **ä¸šåŠ¡å½±å“** |
|---------|------------|-------------|-------------|
| `LRUç®—æ³•` | `ç¼“å­˜ç©ºé—´æ»¡` | `æœ€å°‘ä½¿ç”¨å†…å®¹` | `å‡ ä¹æ— å½±å“` |
| `TTLè¿‡æœŸ` | `è®¾å®šæ—¶é—´åˆ°` | `è¿‡æœŸå†…å®¹` | `æ— å½±å“` |
| `æ‰‹åŠ¨æ¸…ç†` | `å†…å®¹æ›´æ–°` | `æŒ‡å®šå†…å®¹` | `å¯æ§å½±å“` |
| `å®šæ—¶æ¸…ç†` | `æ¯æ—¥å‡Œæ™¨` | `å†·é—¨å†…å®¹` | `æ€§èƒ½ä¼˜åŒ–` |

---

## 5. ğŸ” æœåŠ¡å‘ç°ä¸é…ç½®ç®¡ç†


### 5.1 æœåŠ¡å‘ç°åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°**
æœåŠ¡å‘ç°å°±åƒç”µè¯ç°¿ï¼ŒCDNå®¹å™¨éœ€è¦çŸ¥é“å»å“ªé‡Œæ‰¾åç«¯æœåŠ¡å™¨ã€‚åœ¨ä¼ ç»Ÿéƒ¨ç½²ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å†™æ­»IPåœ°å€ï¼Œä½†åœ¨å®¹å™¨ç¯å¢ƒä¸­ï¼ŒIPåœ°å€ä¼šå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåŠ¨æ€çš„"ç”µè¯ç°¿"ã€‚

**ğŸ”¸ æœåŠ¡å‘ç°çš„å·¥ä½œåŸç†**
```
æ²¡æœ‰æœåŠ¡å‘ç°ï¼š
CDNå®¹å™¨ â†’ å›ºå®šIP:192.168.1.100 â†’ åç«¯æœåŠ¡
é—®é¢˜ï¼šIPå˜åŒ–åè¿æ¥å¤±è´¥

æœ‰äº†æœåŠ¡å‘ç°ï¼š
CDNå®¹å™¨ â†’ æœåŠ¡å:backend-service â†’ åŠ¨æ€IP â†’ åç«¯æœåŠ¡
å¥½å¤„ï¼šIPå˜åŒ–ä¹Ÿèƒ½è‡ªåŠ¨æ‰¾åˆ°æœåŠ¡
```

### 5.2 KubernetesåŸç”ŸæœåŠ¡å‘ç°


**ğŸ”§ DNSæœåŠ¡å‘ç°é…ç½®**

```yaml
# åç«¯æœåŠ¡å®šä¹‰
apiVersion: v1
kind: Service
metadata:
  name: backend-service
  namespace: cdn-system
spec:
  selector:
    app: backend
  ports:
  - port: 8080
    targetPort: 8080
  type: ClusterIP
```

**ğŸ”§ CDNé…ç½®ä¸­çš„æœåŠ¡å‘ç°**

```nginx
upstream backend {
    # ä½¿ç”¨Kubernetes DNSæœåŠ¡å‘ç°
    server backend-service.cdn-system.svc.cluster.local:8080;
    
    # å¥åº·æ£€æŸ¥é…ç½®
    keepalive 32;
    keepalive_requests 100;
    keepalive_timeout 60s;
}

server {
    location / {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # å¥åº·æ£€æŸ¥
        proxy_next_upstream error timeout http_500 http_502 http_503;
        proxy_connect_timeout 3s;
        proxy_send_timeout 5s;
        proxy_read_timeout 5s;
    }
}
```

### 5.3 ConfigMapé…ç½®ç®¡ç†


**ğŸ”¸ é…ç½®åˆ†ç¦»çš„å¥½å¤„**
æŠŠé…ç½®æ–‡ä»¶ä»é•œåƒä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå°±åƒæŠŠè¡£æœå’Œè¡£æŸœåˆ†å¼€ã€‚æ¢å­£èŠ‚æ¢è¡£æœä¸ç”¨æ¢è¡£æŸœï¼Œæ›´æ–°é…ç½®ä¸ç”¨é‡æ–°æ„å»ºé•œåƒã€‚

**ğŸ”§ ConfigMapé…ç½®ç¤ºä¾‹**

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: cdn-config
  namespace: cdn-system
data:
  nginx.conf: |
    user nginx;
    worker_processes auto;
    
    events {
        worker_connections 1024;
    }
    
    http {
        include /etc/nginx/mime.types;
        
        # ç¼“å­˜è®¾ç½®
        proxy_cache_path /var/cache/nginx 
                         levels=1:2 
                         keys_zone=my_cache:100m 
                         max_size=10g;
        
        include /etc/nginx/conf.d/*.conf;
    }
  
  default.conf: |
    server {
        listen 80;
        server_name _;
        
        location / {
            proxy_cache my_cache;
            proxy_cache_valid 200 1h;
            proxy_cache_use_stale error timeout updating;
            
            proxy_pass http://backend-service:8080;
        }
    }
```

**ğŸ”§ åœ¨Deploymentä¸­ä½¿ç”¨ConfigMap**

```yaml
spec:
  template:
    spec:
      containers:
      - name: cdn-server
        image: my-cdn:v1.0
        volumeMounts:
        - name: config-volume
          mountPath: /etc/nginx/nginx.conf
          subPath: nginx.conf
        - name: config-volume
          mountPath: /etc/nginx/conf.d/default.conf
          subPath: default.conf
      volumes:
      - name: config-volume
        configMap:
          name: cdn-config
```

### 5.4 åŠ¨æ€é…ç½®æ›´æ–°


**ğŸ”„ é…ç½®çƒ­æ›´æ–°æµç¨‹**

```
1. æ›´æ–°ConfigMap
   â†“
2. Podè‡ªåŠ¨æ£€æµ‹é…ç½®å˜åŒ–
   â†“
3. é‡æ–°åŠ è½½Nginxé…ç½®
   â†“
4. ä¸ä¸­æ–­æœåŠ¡å®Œæˆæ›´æ–°
```

**ğŸ”§ é…ç½®æ›´æ–°å‘½ä»¤**

```bash
# æ›´æ–°ConfigMap
kubectl patch configmap cdn-config -n cdn-system --patch '
data:
  default.conf: |
    server {
        listen 80;
        location / {
            proxy_cache_valid 200 2h;  # ç¼“å­˜æ—¶é—´æ”¹ä¸º2å°æ—¶
            proxy_pass http://backend-service:8080;
        }
    }'

# è§¦å‘Podé…ç½®é‡è½½
kubectl rollout restart deployment/cdn-deployment -n cdn-system
```

---

## 6. ğŸ“ˆ å¼¹æ€§ä¼¸ç¼©ä¸æ»šåŠ¨æ›´æ–°


### 6.1 å¼¹æ€§ä¼¸ç¼©åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¼¹æ€§ä¼¸ç¼©**
å¼¹æ€§ä¼¸ç¼©å°±åƒé¤å…æ ¹æ®å®¢äººå¤šå°‘æ¥è°ƒæ•´æœåŠ¡å‘˜æ•°é‡ã€‚å®¢äººå¤šçš„æ—¶å€™å¢åŠ æœåŠ¡å‘˜ï¼Œå®¢äººå°‘çš„æ—¶å€™å‡å°‘æœåŠ¡å‘˜ï¼Œä¿è¯æœåŠ¡è´¨é‡çš„åŒæ—¶æ§åˆ¶æˆæœ¬ã€‚

**ğŸ”¸ ä¼¸ç¼©è§¦å‘æ¡ä»¶**
```
CPUä½¿ç”¨ç‡ > 70% â†’ æ‰©å®¹
CPUä½¿ç”¨ç‡ < 30% â†’ ç¼©å®¹

å†…å­˜ä½¿ç”¨ç‡ > 80% â†’ æ‰©å®¹
ç½‘ç»œæµé‡çªå¢ â†’ æ‰©å®¹

åŠå¤œæµé‡ä½ â†’ è‡ªåŠ¨ç¼©å®¹èŠ‚çœèµ„æº
```

### 6.2 æ°´å¹³Podè‡ªåŠ¨ä¼¸ç¼©(HPA)


**ğŸ”§ HPAé…ç½®ç¤ºä¾‹**

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: cdn-hpa
  namespace: cdn-system
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: cdn-deployment
  minReplicas: 2    # æœ€å°‘2ä¸ªå®ä¾‹
  maxReplicas: 20   # æœ€å¤š20ä¸ªå®ä¾‹
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70  # CPUè¾¾åˆ°70%æ—¶æ‰©å®¹
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80  # å†…å­˜è¾¾åˆ°80%æ—¶æ‰©å®¹
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60    # æ‰©å®¹ç¨³å®šæ—¶é—´
      policies:
      - type: Percent
        value: 100    # æ¯æ¬¡æœ€å¤šæ‰©å®¹100%ï¼ˆç¿»å€ï¼‰
        periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300   # ç¼©å®¹ç¨³å®šæ—¶é—´
      policies:
      - type: Percent
        value: 10     # æ¯æ¬¡æœ€å¤šç¼©å®¹10%
        periodSeconds: 60
```

### 6.3 æ»šåŠ¨æ›´æ–°ç­–ç•¥


**ğŸ”¸ æ»šåŠ¨æ›´æ–°çš„å·¥ä½œåŸç†**
æ»šåŠ¨æ›´æ–°å°±åƒæ›´æ¢ç”µæ¢¯ï¼Œä¸æ˜¯æŠŠæ‰€æœ‰ç”µæ¢¯éƒ½åœäº†å†æ¢æ–°çš„ï¼Œè€Œæ˜¯ä¸€éƒ¨ä¸€éƒ¨åœ°æ¢ï¼Œä¿è¯å§‹ç»ˆæœ‰ç”µæ¢¯åœ¨è¿è¡Œã€‚

**ğŸ”§ æ»šåŠ¨æ›´æ–°é…ç½®**

```yaml
spec:
  replicas: 6
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1      # æœ€å¤š1ä¸ªPodä¸å¯ç”¨
      maxSurge: 2           # æœ€å¤šé¢å¤–åˆ›å»º2ä¸ªPod
  template:
    spec:
      containers:
      - name: cdn-server
        image: my-cdn:v2.0    # æ–°ç‰ˆæœ¬é•œåƒ
        readinessProbe:       # å°±ç»ªæ£€æŸ¥
          httpGet:
            path: /health
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 5
        livenessProbe:        # å­˜æ´»æ£€æŸ¥
          httpGet:
            path: /health
            port: 80
          initialDelaySeconds: 30
          periodSeconds: 10
```

**ğŸ“‹ æ»šåŠ¨æ›´æ–°è¿‡ç¨‹è¯¦è§£**

```
åˆå§‹çŠ¶æ€ï¼š6ä¸ªv1.0ç‰ˆæœ¬Podæ­£åœ¨è¿è¡Œ
    [v1.0] [v1.0] [v1.0] [v1.0] [v1.0] [v1.0]

æ­¥éª¤1ï¼šåˆ›å»º2ä¸ªv2.0 Podï¼ˆmaxSurge=2ï¼‰
    [v1.0] [v1.0] [v1.0] [v1.0] [v1.0] [v1.0] [v2.0] [v2.0]

æ­¥éª¤2ï¼šåœæ­¢1ä¸ªv1.0 Podï¼ˆmaxUnavailable=1ï¼‰
    [v1.0] [v1.0] [v1.0] [v1.0] [v1.0] [åœæ­¢] [v2.0] [v2.0]

æ­¥éª¤3ï¼šç»§ç»­åˆ›å»ºv2.0ï¼Œåœæ­¢v1.0ï¼Œç›´åˆ°å…¨éƒ¨æ›´æ–°å®Œæˆ
    [v2.0] [v2.0] [v2.0] [v2.0] [v2.0] [v2.0]
```

### 6.4 æ›´æ–°æ“ä½œå®è·µ


**ğŸš€ æ‰§è¡Œæ»šåŠ¨æ›´æ–°**

```bash
# æ–¹æ³•1ï¼šç›´æ¥è®¾ç½®æ–°é•œåƒ
kubectl set image deployment/cdn-deployment cdn-server=my-cdn:v2.0 -n cdn-system

# æ–¹æ³•2ï¼šåº”ç”¨æ–°çš„yamlæ–‡ä»¶
kubectl apply -f cdn-deployment-v2.yaml -n cdn-system

# æŸ¥çœ‹æ›´æ–°è¿›åº¦
kubectl rollout status deployment/cdn-deployment -n cdn-system

# æŸ¥çœ‹æ›´æ–°å†å²
kubectl rollout history deployment/cdn-deployment -n cdn-system
```

**ğŸ”„ å›æ»šæ“ä½œ**

```bash
# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/cdn-deployment -n cdn-system

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
kubectl rollout undo deployment/cdn-deployment --to-revision=2 -n cdn-system

# æŸ¥çœ‹å›æ»šçŠ¶æ€
kubectl rollout status deployment/cdn-deployment -n cdn-system
```

**ğŸ“Š æ›´æ–°ç›‘æ§æŒ‡æ ‡**

| ç›‘æ§é¡¹ç›® | **æ­£å¸¸å€¼** | **å¼‚å¸¸å¤„ç†** |
|---------|-----------|-------------|
| `Podå°±ç»ªæ—¶é—´` | `< 30ç§’` | `æ£€æŸ¥é•œåƒæ‹‰å–å’Œå¥åº·æ£€æŸ¥` |
| `æœåŠ¡å¯ç”¨æ€§` | `> 99.9%` | `è°ƒæ•´æ»šåŠ¨æ›´æ–°å‚æ•°` |
| `é”™è¯¯ç‡` | `< 0.1%` | `ç«‹å³å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬` |
| `å“åº”æ—¶é—´` | `< 100ms` | `æ£€æŸ¥æ–°ç‰ˆæœ¬æ€§èƒ½é—®é¢˜` |

---

## 7. ğŸŒ ç½‘ç»œä¸å­˜å‚¨é…ç½®


### 7.1 å®¹å™¨ç½‘ç»œåŸºç¡€


**ğŸ”¸ Kubernetesç½‘ç»œæ¨¡å‹**
Kubernetesç½‘ç»œå°±åƒä¸€ä¸ªè™šæ‹Ÿçš„å¤§å±€åŸŸç½‘ï¼Œæ‰€æœ‰å®¹å™¨éƒ½èƒ½äº’ç›¸é€šä¿¡ï¼Œå°±åƒåœ¨åŒä¸€ä¸ªåŠå…¬å®¤é‡Œçš„å‘˜å·¥éƒ½èƒ½ç›´æ¥å¯¹è¯ï¼Œä¸éœ€è¦é€šè¿‡å‰å°è½¬æ¥ã€‚

**ğŸ”¸ ç½‘ç»œå±‚æ¬¡ç»“æ„**
```
å¤–éƒ¨ç”¨æˆ·è¯·æ±‚
       â†“
LoadBalancer Service (å…¬ç½‘IP)
       â†“
ClusterIP Service (é›†ç¾¤å†…IP)
       â†“
Podç½‘ç»œ (å®¹å™¨IP)
       â†“
Containerå†…éƒ¨ (localhost)
```

### 7.2 CDNç½‘ç»œé…ç½®å®è·µ


**ğŸ”§ å¤šå±‚è´Ÿè½½å‡è¡¡é…ç½®**

```yaml
# å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨
apiVersion: v1
kind: Service
metadata:
  name: cdn-external-lb
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
spec:
  type: LoadBalancer
  selector:
    app: cdn
  ports:
  - name: http
    port: 80
    targetPort: 80
    protocol: TCP
  - name: https
    port: 443
    targetPort: 443
    protocol: TCP
  externalTrafficPolicy: Local  # ä¿æŒå®¢æˆ·ç«¯IP
```

**ğŸ”§ Ingressæ§åˆ¶å™¨é…ç½®**

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: cdn-ingress
  annotations:
    nginx.ingress.kubernetes.io/proxy-cache-valid: "200 1h"
    nginx.ingress.kubernetes.io/proxy-cache-key: "$scheme$request_method$host$request_uri"
    nginx.ingress.kubernetes.io/proxy-buffering: "on"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - cdn.example.com
    secretName: cdn-tls-secret
  rules:
  - host: cdn.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: cdn-service
            port:
              number: 80
```

### 7.3 ç½‘ç»œæ€§èƒ½ä¼˜åŒ–


**âš¡ ç½‘ç»œä¼˜åŒ–ç­–ç•¥**

| ä¼˜åŒ–é¡¹ç›® | **é…ç½®æ–¹æ³•** | **æ€§èƒ½æå‡** |
|---------|------------|-------------|
| `è¿æ¥å¤ç”¨` | `keepalive_requests 1000` | `å‡å°‘30%è¿æ¥å¼€é”€` |
| `ç¼“å†²ä¼˜åŒ–` | `proxy_buffering on` | `æé«˜20%ååé‡` |
| `å‹ç¼©ä¼ è¾“` | `gzip on` | `å‡å°‘60%ä¼ è¾“æ•°æ®` |
| `TCPä¼˜åŒ–` | `net.core.rmem_max` | `æé«˜ç½‘ç»œåå` |

**ğŸ”§ ç½‘ç»œç­–ç•¥é…ç½®**

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cdn-network-policy
spec:
  podSelector:
    matchLabels:
      app: cdn
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    ports:
    - protocol: TCP
      port: 80
    - protocol: TCP
      port: 443
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: backend-system
    ports:
    - protocol: TCP
      port: 8080
```

### 7.4 å­˜å‚¨å·ç®¡ç†


**ğŸ”¸ å­˜å‚¨ç±»å‹é€‰æ‹©**

```
ä¸´æ—¶å­˜å‚¨ (emptyDir)ï¼š
ç”¨é€”ï¼šä¸´æ—¶ç¼“å­˜ã€æ—¥å¿—æ–‡ä»¶
ç‰¹ç‚¹ï¼šPodé‡å¯æ•°æ®ä¸¢å¤±
æ€§èƒ½ï¼šæœ€å¿«

æŒä¹…å­˜å‚¨ (PV/PVC)ï¼š
ç”¨é€”ï¼šé‡è¦ç¼“å­˜æ•°æ®
ç‰¹ç‚¹ï¼šæ•°æ®æŒä¹…åŒ–ä¿å­˜
æ€§èƒ½ï¼šè¾ƒå¿«

ç½‘ç»œå­˜å‚¨ (NFS/Ceph)ï¼š
ç”¨é€”ï¼šå…±äº«æ•°æ®ã€å¤‡ä»½
ç‰¹ç‚¹ï¼šå¤šPodå…±äº«è®¿é—®
æ€§èƒ½ï¼šå—ç½‘ç»œå½±å“
```

**ğŸ”§ å­˜å‚¨å·é…ç½®ç¤ºä¾‹**

```yaml
# PersistentVolumeClaimå®šä¹‰
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: cdn-cache-pvc
spec:
  accessModes:
  - ReadWriteOnce
  storageClassName: fast-ssd
  resources:
    requests:
      storage: 50Gi

---
# åœ¨Deploymentä¸­ä½¿ç”¨å­˜å‚¨å·
spec:
  template:
    spec:
      containers:
      - name: cdn-server
        volumeMounts:
        - name: cache-storage
          mountPath: /var/cache/nginx
        - name: config-storage
          mountPath: /etc/nginx/conf.d
          readOnly: true
        - name: log-storage
          mountPath: /var/log/nginx
      volumes:
      - name: cache-storage
        persistentVolumeClaim:
          claimName: cdn-cache-pvc
      - name: config-storage
        configMap:
          name: cdn-config
      - name: log-storage
        emptyDir: {}
```

**ğŸ“Š å­˜å‚¨æ€§èƒ½ç›‘æ§**

| ç›‘æ§æŒ‡æ ‡ | **å‘Šè­¦é˜ˆå€¼** | **å¤„ç†æ–¹æ³•** |
|---------|------------|-------------|
| `ç£ç›˜ä½¿ç”¨ç‡` | `> 85%` | `æ¸…ç†ç¼“å­˜æˆ–æ‰©å®¹` |
| `IOPSä½¿ç”¨ç‡` | `> 80%` | `å‡çº§å­˜å‚¨ç±»å‹` |
| `è¯»å†™å»¶è¿Ÿ` | `> 10ms` | `æ£€æŸ¥å­˜å‚¨ç½‘ç»œ` |
| `ç¼“å­˜å‘½ä¸­ç‡` | `< 70%` | `è°ƒæ•´ç¼“å­˜ç­–ç•¥` |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å®¹å™¨åŒ–CDNå…³é”®æ¦‚å¿µ


**ğŸ”¸ æ ¸å¿ƒç†è§£è¦ç‚¹**
```
å®¹å™¨åŒ– = æ ‡å‡†åŒ–éƒ¨ç½² + ç¯å¢ƒä¸€è‡´æ€§ + å¿«é€Ÿæ‰©å±•
Docker = åº”ç”¨æ‰“åŒ…å·¥å…· + è¿è¡Œç¯å¢ƒéš”ç¦»
Kubernetes = å®¹å™¨ç¼–æ’å¹³å° + è‡ªåŠ¨åŒ–ç®¡ç†
ç¼“å­˜å­˜å‚¨ = æ•°æ®æŒä¹…åŒ– + æ€§èƒ½ä¼˜åŒ–
æœåŠ¡å‘ç° = åŠ¨æ€æœåŠ¡å®šä½ + é…ç½®ç®¡ç†
å¼¹æ€§ä¼¸ç¼© = è‡ªåŠ¨èµ„æºè°ƒæ•´ + æˆæœ¬ä¼˜åŒ–
```

### 8.2 æŠ€æœ¯é€‰å‹å»ºè®®


**ğŸ¯ åœºæ™¯å¯¹åº”æ–¹æ¡ˆ**

| åº”ç”¨åœºæ™¯ | **æ¨èæ–¹æ¡ˆ** | **æ ¸å¿ƒè€ƒè™‘** |
|---------|------------|-------------|
| `å°è§„æ¨¡CDN` | `Docker + è´Ÿè½½å‡è¡¡` | `ç®€å•æ˜“ç®¡ç†` |
| `ä¸­ç­‰è§„æ¨¡CDN` | `Kubernetes + HPA` | `è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜` |
| `å¤§è§„æ¨¡CDN` | `K8s + å¤šé›†ç¾¤` | `é«˜å¯ç”¨æ€§` |
| `è¾¹ç¼˜è®¡ç®—CDN` | `è½»é‡çº§K8s + è¾¹ç¼˜èŠ‚ç‚¹` | `ä½å»¶è¿Ÿè¦æ±‚` |

### 8.3 å®æ–½è·¯å¾„è§„åˆ’


**ğŸ“… åˆ†é˜¶æ®µå®æ–½å»ºè®®**

**é˜¶æ®µ1ï¼šåŸºç¡€å®¹å™¨åŒ–ï¼ˆ1-2å‘¨ï¼‰**
- [x] Dockeré•œåƒæ„å»ºå’Œä¼˜åŒ–
- [x] åŸºç¡€Kubernetesé›†ç¾¤æ­å»º
- [x] ç®€å•çš„CDNæœåŠ¡éƒ¨ç½²

**é˜¶æ®µ2ï¼šåŠŸèƒ½å®Œå–„ï¼ˆ2-3å‘¨ï¼‰**  
- [x] ç¼“å­˜å­˜å‚¨æ–¹æ¡ˆå®æ–½
- [x] æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†
- [x] ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

**é˜¶æ®µ3ï¼šç”Ÿäº§ä¼˜åŒ–ï¼ˆ3-4å‘¨ï¼‰**
- [x] å¼¹æ€§ä¼¸ç¼©ç­–ç•¥è°ƒä¼˜
- [x] æ»šåŠ¨æ›´æ–°æµç¨‹å®Œå–„
- [x] å®‰å…¨å’Œæ€§èƒ½ä¼˜åŒ–

**é˜¶æ®µ4ï¼šé«˜çº§ç‰¹æ€§ï¼ˆæŒç»­ä¼˜åŒ–ï¼‰**
- [x] å¤šé›†ç¾¤ç®¡ç†
- [x] è¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²
- [x] AIé©±åŠ¨çš„æ™ºèƒ½è°ƒåº¦

### 8.4 è¿ç»´æœ€ä½³å®è·µ


**ğŸ”§ å…³é”®è¿ç»´è¦ç‚¹**

**ç›‘æ§ä½“ç³»**ï¼š
- **åº”ç”¨å±‚**ï¼šCDNæœåŠ¡çŠ¶æ€ã€ç¼“å­˜å‘½ä¸­ç‡ã€å“åº”æ—¶é—´
- **å®¹å™¨å±‚**ï¼šPodçŠ¶æ€ã€èµ„æºä½¿ç”¨ã€é‡å¯æ¬¡æ•°
- **é›†ç¾¤å±‚**ï¼šèŠ‚ç‚¹å¥åº·ã€ç½‘ç»œè¿é€šæ€§ã€å­˜å‚¨çŠ¶æ€

**å®‰å…¨æªæ–½**ï¼š
- **é•œåƒå®‰å…¨**ï¼šå®šæœŸæ‰«ææ¼æ´ã€ä½¿ç”¨å¯ä¿¡åŸºç¡€é•œåƒ
- **ç½‘ç»œå®‰å…¨**ï¼šç½‘ç»œç­–ç•¥éš”ç¦»ã€TLSåŠ å¯†ä¼ è¾“
- **è®¿é—®æ§åˆ¶**ï¼šRBACæƒé™ç®¡ç†ã€å¯†é’¥è½®æ¢

**å¤‡ä»½ç­–ç•¥**ï¼š
- **é…ç½®å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½ConfigMapå’ŒDeploymenté…ç½®
- **æ•°æ®å¤‡ä»½**ï¼šæŒä¹…åŒ–å­˜å‚¨çš„å®šæœŸå¿«ç…§
- **é›†ç¾¤å¤‡ä»½**ï¼šetcdæ•°æ®å¤‡ä»½å’Œæ¢å¤æµ‹è¯•

> ğŸ’¡ **æˆåŠŸå…³é”®å› ç´ **  
> å®¹å™¨åŒ–CDNçš„æˆåŠŸä¸ä»…åœ¨äºæŠ€æœ¯å®ç°ï¼Œæ›´åœ¨äºè¿ç»´æµç¨‹çš„æ ‡å‡†åŒ–å’Œè‡ªåŠ¨åŒ–ã€‚å»ºè®®ä»å°è§„æ¨¡å¼€å§‹ï¼Œé€æ­¥ç§¯ç´¯ç»éªŒåå†æ‰©å¤§è§„æ¨¡ã€‚

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- å®¹å™¨åŒ–è§£å†³éƒ¨ç½²å’Œæ‰©å±•é—®é¢˜ï¼ŒKubernetesæä¾›ç¼–æ’èƒ½åŠ›
- ç¼“å­˜å­˜å‚¨éœ€è¦è€ƒè™‘æ€§èƒ½å’ŒæŒä¹…åŒ–çš„å¹³è¡¡
- æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†å®ç°åŠ¨æ€åŒ–è¿ç»´
- å¼¹æ€§ä¼¸ç¼©å’Œæ»šåŠ¨æ›´æ–°ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨æ€§
- ç½‘ç»œå’Œå­˜å‚¨é…ç½®æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç¯èŠ‚