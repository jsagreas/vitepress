---
title: 11ã€éƒ¨ç½²ç­–ç•¥ä¸ç¯å¢ƒç®¡ç†
---
## ğŸ“š ç›®å½•

1. [éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ](#1-éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ)
2. [è“ç»¿éƒ¨ç½²å®ç°](#2-è“ç»¿éƒ¨ç½²å®ç°)
3. [æ»šåŠ¨æ›´æ–°éƒ¨ç½²](#3-æ»šåŠ¨æ›´æ–°éƒ¨ç½²)
4. [é‡‘ä¸é›€å‘å¸ƒç­–ç•¥](#4-é‡‘ä¸é›€å‘å¸ƒç­–ç•¥)
5. [å¤šç¯å¢ƒéƒ¨ç½²ç®¡ç†](#5-å¤šç¯å¢ƒéƒ¨ç½²ç®¡ç†)
6. [ç¯å¢ƒé…ç½®ç®¡ç†](#6-ç¯å¢ƒé…ç½®ç®¡ç†)
7. [æ•°æ®åº“è¿ç§»å¤„ç†](#7-æ•°æ®åº“è¿ç§»å¤„ç†)
8. [æœåŠ¡å¥åº·æ£€æŸ¥](#8-æœåŠ¡å¥åº·æ£€æŸ¥)
9. [å›æ»šæœºåˆ¶é…ç½®](#9-å›æ»šæœºåˆ¶é…ç½®)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ


### 1.1 ä»€ä¹ˆæ˜¯éƒ¨ç½²ç­–ç•¥


**ç®€å•ç†è§£**ï¼šéƒ¨ç½²ç­–ç•¥å°±æ˜¯æŠŠæ–°ç‰ˆæœ¬åº”ç”¨ä¸Šçº¿çš„æ–¹æ³•ï¼Œå°±åƒæ¢è½®èƒä¸€æ ·ï¼Œæœ‰ä¸åŒçš„æ¢æ³•ã€‚

```
ä¼ ç»Ÿéƒ¨ç½² vs ç°ä»£éƒ¨ç½²ç­–ç•¥ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼ˆåœæœºéƒ¨ç½²ï¼‰ï¼š
æ—§ç‰ˆæœ¬ â†’ åœæœåŠ¡ â†’ æ›´æ–° â†’ å¯åŠ¨æ–°ç‰ˆæœ¬
é—®é¢˜ï¼šç”¨æˆ·æ— æ³•è®¿é—®ï¼Œä¸šåŠ¡ä¸­æ–­

ç°ä»£ç­–ç•¥ï¼š
è®©ç”¨æˆ·æ„Ÿè§‰ä¸åˆ°æ›´æ–°è¿‡ç¨‹ï¼ŒæœåŠ¡ä¸ä¸­æ–­
```

### 1.2 ä¸»æµéƒ¨ç½²ç­–ç•¥å¯¹æ¯”


| ç­–ç•¥ç±»å‹ | **é£é™©ç­‰çº§** | **éƒ¨ç½²é€Ÿåº¦** | **èµ„æºéœ€æ±‚** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|------------|-------------|-------------|
| ğŸ”„ **æ»šåŠ¨æ›´æ–°** | `ä¸­ç­‰` | `ä¸­ç­‰` | `æ ‡å‡†` | `å¤§éƒ¨åˆ†åº”ç”¨` |
| ğŸ”µ **è“ç»¿éƒ¨ç½²** | `ä½` | `å¿«` | `åŒå€` | `å…³é”®ä¸šåŠ¡ç³»ç»Ÿ` |
| ğŸ¦ **é‡‘ä¸é›€å‘å¸ƒ** | `æä½` | `æ…¢` | `å°‘é‡é¢å¤–` | `ç”¨æˆ·æ•æ„Ÿåº”ç”¨` |
| âš¡ **åœæœºéƒ¨ç½²** | `é«˜` | `å¿«` | `æœ€å°‘` | `å†…éƒ¨ç³»ç»Ÿ` |

### 1.3 éƒ¨ç½²ç­–ç•¥é€‰æ‹©åŸåˆ™


> ğŸ’¡ **é€‰æ‹©æŒ‡å¯¼**  
> - **ä¸šåŠ¡é‡è¦æ€§**ï¼šè¶Šé‡è¦è¶Šéœ€è¦å®‰å…¨çš„ç­–ç•¥
> - **ç”¨æˆ·è§„æ¨¡**ï¼šç”¨æˆ·è¶Šå¤šè¶Šä¸èƒ½åœæœº
> - **èµ„æºæˆæœ¬**ï¼šè€ƒè™‘æœåŠ¡å™¨å’Œæ—¶é—´æˆæœ¬
> - **æŠ€æœ¯å¤æ‚åº¦**ï¼šå›¢é˜ŸæŠ€æœ¯èƒ½åŠ›åŒ¹é…

---

## 2. ğŸ”µ è“ç»¿éƒ¨ç½²å®ç°


### 2.1 è“ç»¿éƒ¨ç½²æ ¸å¿ƒæ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šå°±åƒå‡†å¤‡ä¸¤å¥—å®Œå…¨ç›¸åŒçš„æˆ¿å­ï¼Œç”¨æˆ·ä½åœ¨è“æˆ¿å­é‡Œï¼Œç»¿æˆ¿å­å‡†å¤‡å¥½æ–°è£…ä¿®åï¼Œç¬é—´è®©ç”¨æˆ·æ¬åˆ°ç»¿æˆ¿å­ï¼Œè“æˆ¿å­å˜æˆå¤‡ç”¨ã€‚

```
è“ç»¿éƒ¨ç½²ç¤ºæ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è´Ÿè½½å‡è¡¡å™¨  â”‚â”€â”€â”€â”€â”‚  ç”¨æˆ·æµé‡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
    æµé‡åˆ‡æ¢
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è“ç¯å¢ƒ(æ—§)   â”‚    â”‚  ç»¿ç¯å¢ƒ(æ–°)  â”‚
â”‚  Version 1.0 â”‚    â”‚  Version 2.0â”‚
â”‚  â­ å½“å‰æœåŠ¡  â”‚    â”‚  ğŸ”§ å‡†å¤‡å°±ç»ª  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Jenkinsè“ç»¿éƒ¨ç½²é…ç½®


```groovy
pipeline {
    agent any
    
    environment {
        BLUE_PORT = "8080"
        GREEN_PORT = "8081" 
        NGINX_CONFIG = "/etc/nginx/conf.d/app.conf"
    }
    
    stages {
        stage('å‡†å¤‡ç»¿ç¯å¢ƒ') {
            steps {
                script {
                    // éƒ¨ç½²åˆ°ç»¿ç¯å¢ƒ
                    sh """
                        docker stop app-green || true
                        docker rm app-green || true
                        docker run -d --name app-green -p ${GREEN_PORT}:8080 myapp:${BUILD_NUMBER}
                    """
                }
            }
        }
        
        stage('å¥åº·æ£€æŸ¥') {
            steps {
                script {
                    // æ£€æŸ¥ç»¿ç¯å¢ƒæ˜¯å¦æ­£å¸¸
                    timeout(time: 5, unit: 'MINUTES') {
                        waitUntil {
                            script {
                                def result = sh(script: "curl -f http://localhost:${GREEN_PORT}/health", returnStatus: true)
                                return result == 0
                            }
                        }
                    }
                }
            }
        }
        
        stage('æµé‡åˆ‡æ¢') {
            steps {
                script {
                    // æ›´æ–°Nginxé…ç½®ï¼Œæµé‡åˆ‡åˆ°ç»¿ç¯å¢ƒ
                    sh """
                        sed -i 's/${BLUE_PORT}/${GREEN_PORT}/g' ${NGINX_CONFIG}
                        nginx -s reload
                    """
                }
            }
        }
        
        stage('æ¸…ç†è“ç¯å¢ƒ') {
            steps {
                script {
                    // æ¸…ç†æ—§çš„è“ç¯å¢ƒ
                    sh "docker stop app-blue || true"
                    sh "docker rm app-blue || true"
                }
            }
        }
    }
}
```

### 2.3 GitLab CIè“ç»¿éƒ¨ç½²


```yaml
# .gitlab-ci.yml
stages:
  - build
  - deploy-green
  - switch-traffic
  - cleanup

variables:
  BLUE_ENV: "production-blue"
  GREEN_ENV: "production-green"

deploy_green:
  stage: deploy-green
  script:
    # éƒ¨ç½²åˆ°ç»¿ç¯å¢ƒ
    - helm upgrade --install $GREEN_ENV ./helm-chart
    - kubectl wait --for=condition=ready pod -l app=$GREEN_ENV
  
switch_traffic:
  stage: switch-traffic
  script:
    # åˆ‡æ¢æµé‡åˆ°ç»¿ç¯å¢ƒ
    - kubectl patch service app-service -p '{"spec":{"selector":{"version":"green"}}}'
  when: manual  # æ‰‹åŠ¨è§¦å‘
  
cleanup_blue:
  stage: cleanup
  script:
    # æ¸…ç†è“ç¯å¢ƒ
    - helm uninstall $BLUE_ENV
```

### 2.4 è“ç»¿éƒ¨ç½²ä¼˜ç¼ºç‚¹


**âœ… ä¼˜åŠ¿**ï¼š
- **ç¬é—´åˆ‡æ¢**ï¼šå‡ ç§’é’Ÿå®Œæˆéƒ¨ç½²
- **å¿«é€Ÿå›æ»š**ï¼šå‡ºé—®é¢˜ç«‹å³åˆ‡å›
- **é›¶åœæœºæ—¶é—´**ï¼šç”¨æˆ·æ— æ„ŸçŸ¥
- **å®Œæ•´æµ‹è¯•**ï¼šç”Ÿäº§ç¯å¢ƒçœŸå®æµ‹è¯•

**âŒ ç¼ºç‚¹**ï¼š
- **èµ„æºç¿»å€**ï¼šéœ€è¦ä¸¤å¥—å®Œæ•´ç¯å¢ƒ
- **çŠ¶æ€åŒæ­¥**ï¼šæ•°æ®åº“çŠ¶æ€å¤„ç†å¤æ‚
- **æˆæœ¬è¾ƒé«˜**ï¼šæœåŠ¡å™¨èµ„æºæ¶ˆè€—å¤§

---

## 3. ğŸ”„ æ»šåŠ¨æ›´æ–°éƒ¨ç½²


### 3.1 æ»šåŠ¨æ›´æ–°åŸºæœ¬åŸç†


**é€šä¿—ç†è§£**ï¼šå°±åƒæ›´æ¢å¤§å·´è½¦é˜Ÿï¼Œä¸æ˜¯ä¸€æ¬¡æ€§æ¢æ‰€æœ‰è½¦ï¼Œè€Œæ˜¯ä¸€è¾†ä¸€è¾†åœ°æ¢ï¼Œä¿è¯å§‹ç»ˆæœ‰è½¦åœ¨è¿è¥ã€‚

```
æ»šåŠ¨æ›´æ–°è¿‡ç¨‹ç¤ºæ„ï¼š
åˆå§‹çŠ¶æ€ï¼š[V1] [V1] [V1] [V1]
æ­¥éª¤1ï¼š   [V2] [V1] [V1] [V1]  â† æ›´æ–°ç¬¬1ä¸ª
æ­¥éª¤2ï¼š   [V2] [V2] [V1] [V1]  â† æ›´æ–°ç¬¬2ä¸ª
æ­¥éª¤3ï¼š   [V2] [V2] [V2] [V1]  â† æ›´æ–°ç¬¬3ä¸ª
æœ€ç»ˆï¼š    [V2] [V2] [V2] [V2]  â† å…¨éƒ¨æ›´æ–°å®Œæˆ
```

### 3.2 Kubernetesæ»šåŠ¨æ›´æ–°


```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 4
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1    # æœ€å¤š1ä¸ªpodä¸å¯ç”¨
      maxSurge: 1          # æœ€å¤šå¤šå‡º1ä¸ªpod
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: app
        image: myapp:v2.0
        readinessProbe:    # å°±ç»ªæ£€æŸ¥å¾ˆé‡è¦
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 5
```

### 3.3 Jenkinsæ»šåŠ¨æ›´æ–°æµæ°´çº¿


```groovy
pipeline {
    agent any
    
    stages {
        stage('æ»šåŠ¨æ›´æ–°éƒ¨ç½²') {
            steps {
                script {
                    // è·å–å½“å‰å®ä¾‹åˆ—è¡¨
                    def instances = sh(
                        script: "docker ps --filter name=app- --format '{{.Names}}'",
                        returnStdout: true
                    ).trim().split('\n')
                    
                    // é€ä¸ªæ›´æ–°å®ä¾‹
                    for (instance in instances) {
                        echo "æ›´æ–°å®ä¾‹: ${instance}"
                        
                        // å¯åŠ¨æ–°å®ä¾‹
                        sh "docker run -d --name ${instance}-new myapp:${BUILD_NUMBER}"
                        
                        // ç­‰å¾…æ–°å®ä¾‹å°±ç»ª
                        sleep(30)
                        
                        // åœæ­¢æ—§å®ä¾‹
                        sh "docker stop ${instance}"
                        sh "docker rm ${instance}"
                        
                        // é‡å‘½åæ–°å®ä¾‹
                        sh "docker rename ${instance}-new ${instance}"
                        
                        echo "å®ä¾‹ ${instance} æ›´æ–°å®Œæˆ"
                    }
                }
            }
        }
    }
}
```

### 3.4 æ»šåŠ¨æ›´æ–°é…ç½®å‚æ•°


> ğŸ”§ **å…³é”®é…ç½®å‚æ•°**  
> - **maxUnavailable**: æœ€å¤šå‡ ä¸ªå®ä¾‹ä¸å¯ç”¨
> - **maxSurge**: æœ€å¤šå¯ä»¥å¤šå‡ºå‡ ä¸ªå®ä¾‹  
> - **progressDeadlineSeconds**: æ›´æ–°è¶…æ—¶æ—¶é—´
> - **revisionHistoryLimit**: ä¿ç•™å¤šå°‘ä¸ªå†å²ç‰ˆæœ¬

**å‚æ•°è°ƒä¼˜å»ºè®®**ï¼š
- **é«˜å¯ç”¨è¦æ±‚**ï¼š`maxUnavailable=0, maxSurge=1`
- **å¿«é€Ÿéƒ¨ç½²**ï¼š`maxUnavailable=50%, maxSurge=0`
- **èµ„æºå—é™**ï¼š`maxUnavailable=1, maxSurge=0`

---

## 4. ğŸ¦ é‡‘ä¸é›€å‘å¸ƒç­–ç•¥


### 4.1 é‡‘ä¸é›€å‘å¸ƒæ ¸å¿ƒæ€æƒ³


**ç”Ÿæ´»åŒ–ç†è§£**ï¼šå°±åƒçŸ¿å·¥ç”¨é‡‘ä¸é›€æµ‹è¯•çŸ¿äº•å®‰å…¨ä¸€æ ·ï¼Œå…ˆè®©å°‘éƒ¨åˆ†ç”¨æˆ·"è¯•æ¯’"ï¼Œç¡®è®¤æ–°ç‰ˆæœ¬æ²¡é—®é¢˜å†å…¨é‡å‘å¸ƒã€‚

```
é‡‘ä¸é›€å‘å¸ƒæµé‡åˆ†é…ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æµé‡   â”‚ 100%
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è´Ÿè½½å‡è¡¡å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚       â”‚
  95%     5%  â† æµé‡æ¯”ä¾‹
   â”‚       â”‚
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ æ—§ç‰ˆæœ¬â”‚ â”‚æ–°ç‰ˆæœ¬â”‚
â”‚ V1.0 â”‚ â”‚ V2.0â”‚
â”‚ ç¨³å®š â”‚ â”‚ é‡‘ä¸é›€â”‚
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
```

### 4.2 åŸºäºæƒé‡çš„é‡‘ä¸é›€å‘å¸ƒ


```yaml
# Istioé‡‘ä¸é›€é…ç½®
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: app-canary
spec:
  hosts:
  - myapp
  http:
  - match:
    - headers:
        canary:
          exact: "true"
    route:
    - destination:
        host: myapp
        subset: v2
  - route:
    - destination:
        host: myapp
        subset: v1
      weight: 90  # 90%æµé‡åˆ°æ—§ç‰ˆæœ¬
    - destination:
        host: myapp
        subset: v2
      weight: 10  # 10%æµé‡åˆ°æ–°ç‰ˆæœ¬
```

### 4.3 Jenkinsé‡‘ä¸é›€å‘å¸ƒæµæ°´çº¿


```groovy
pipeline {
    agent any
    
    parameters {
        choice(
            name: 'CANARY_PERCENTAGE',
            choices: ['5', '10', '25', '50', '100'],
            description: 'é‡‘ä¸é›€æµé‡ç™¾åˆ†æ¯”'
        )
    }
    
    stages {
        stage('éƒ¨ç½²é‡‘ä¸é›€ç‰ˆæœ¬') {
            steps {
                script {
                    sh """
                        # éƒ¨ç½²é‡‘ä¸é›€å®ä¾‹
                        docker run -d --name app-canary-${BUILD_NUMBER} \
                            -l traefik.http.services.app-canary.loadbalancer.server.port=8080 \
                            -l traefik.http.routers.app-canary.rule="Host(\`myapp.com\`) && Headers(\`X-Canary\`, \`true\`)" \
                            myapp:${BUILD_NUMBER}
                    """
                }
            }
        }
        
        stage('é…ç½®æµé‡åˆ†é…') {
            steps {
                script {
                    def canaryWeight = params.CANARY_PERCENTAGE
                    def stableWeight = 100 - canaryWeight.toInteger()
                    
                    sh """
                        # æ›´æ–°è´Ÿè½½å‡è¡¡å™¨é…ç½®
                        kubectl patch service app-service -p '{
                            "metadata": {
                                "annotations": {
                                    "traefik.ingress.kubernetes.io/service.weights.app-stable": "${stableWeight}",
                                    "traefik.ingress.kubernetes.io/service.weights.app-canary": "${canaryWeight}"
                                }
                            }
                        }'
                    """
                }
            }
        }
        
        stage('ç›‘æ§é‡‘ä¸é›€æŒ‡æ ‡') {
            steps {
                script {
                    // ç›‘æ§é”™è¯¯ç‡å’Œå“åº”æ—¶é—´
                    sh """
                        # è¿è¡Œ5åˆ†é’Ÿç›‘æ§
                        for i in {1..30}; do
                            ERROR_RATE=\$(curl -s http://prometheus:9090/api/v1/query?query=error_rate | jq '.data.result[0].value[1]')
                            if (( \$(echo "\$ERROR_RATE > 0.05" | bc -l) )); then
                                echo "é”™è¯¯ç‡è¿‡é«˜: \$ERROR_RATEï¼Œåœæ­¢é‡‘ä¸é›€å‘å¸ƒ"
                                exit 1
                            fi
                            sleep 10
                        done
                    """
                }
            }
        }
        
        stage('å†³ç­–ï¼šå…¨é‡å‘å¸ƒæˆ–å›æ»š') {
            steps {
                script {
                    def userInput = input(
                        message: 'é‡‘ä¸é›€æµ‹è¯•å®Œæˆï¼Œé€‰æ‹©ä¸‹ä¸€æ­¥æ“ä½œï¼š',
                        parameters: [
                            choice(choices: ['å…¨é‡å‘å¸ƒ', 'å›æ»š'], name: 'ACTION')
                        ]
                    )
                    
                    if (userInput == 'å…¨é‡å‘å¸ƒ') {
                        sh "kubectl set image deployment/app app=myapp:${BUILD_NUMBER}"
                    } else {
                        sh "docker stop app-canary-${BUILD_NUMBER}"
                    }
                }
            }
        }
    }
}
```

### 4.4 é‡‘ä¸é›€å‘å¸ƒæœ€ä½³å®è·µ


> âš ï¸ **å…³é”®ç›‘æ§æŒ‡æ ‡**  
> - **é”™è¯¯ç‡**ï¼šæ–°ç‰ˆæœ¬ä¸èƒ½æ¯”æ—§ç‰ˆæœ¬é«˜
> - **å“åº”æ—¶é—´**ï¼šæ€§èƒ½ä¸èƒ½æ˜¾è‘—ä¸‹é™
> - **ä¸šåŠ¡æŒ‡æ ‡**ï¼šè½¬åŒ–ç‡ã€ç”¨æˆ·è¡Œä¸ºç­‰
> - **ç³»ç»Ÿèµ„æº**ï¼šCPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ

**å‘å¸ƒç­–ç•¥å»ºè®®**ï¼š
- **é˜¶æ®µå¼å‘å¸ƒ**ï¼š5% â†’ 10% â†’ 25% â†’ 50% â†’ 100%
- **ç”¨æˆ·åˆ†ç»„**ï¼šå†…éƒ¨ç”¨æˆ· â†’ VIPç”¨æˆ· â†’ æ™®é€šç”¨æˆ·
- **åœ°ç†åˆ†å¸ƒ**ï¼šç‰¹å®šåœ°åŒº â†’ å…¨çƒå‘å¸ƒ

---

## 5. ğŸŒ å¤šç¯å¢ƒéƒ¨ç½²ç®¡ç†


### 5.1 ç¯å¢ƒåˆ†å±‚æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šå°±åƒç›–æˆ¿å­ï¼Œè¦å…ˆç”»å›¾çº¸(å¼€å‘)ï¼Œå»ºä¸ªæ¨¡å‹(æµ‹è¯•)ï¼Œæœ€åæ‰ç›–çœŸæˆ¿å­(ç”Ÿäº§)ã€‚

```
ç¯å¢ƒæµè½¬å›¾ï¼š
å¼€å‘ç¯å¢ƒ(DEV) â†’ æµ‹è¯•ç¯å¢ƒ(TEST) â†’ é¢„å‘ç¯å¢ƒ(STAGE) â†’ ç”Ÿäº§ç¯å¢ƒ(PROD)
    â†“              â†“               â†“               â†“
  åŠŸèƒ½å¼€å‘        é›†æˆæµ‹è¯•         éªŒæ”¶æµ‹è¯•        æ­£å¼æœåŠ¡
  å¿«é€Ÿè¿­ä»£        å‘ç°Bug         æ¨¡æ‹Ÿç”Ÿäº§        é«˜ç¨³å®šæ€§
```

### 5.2 ç¯å¢ƒç‰¹ç‚¹å¯¹æ¯”


| ç¯å¢ƒç±»å‹ | **æ•°æ®æ¥æº** | **ç¨³å®šæ€§è¦æ±‚** | **èµ„æºé…ç½®** | **è®¿é—®æƒé™** |
|---------|------------|--------------|-------------|-------------|
| ğŸ”§ **å¼€å‘ç¯å¢ƒ** | `æ¨¡æ‹Ÿæ•°æ®` | `ä½` | `æœ€å°åŒ–` | `å¼€å‘å›¢é˜Ÿ` |
| ğŸ§ª **æµ‹è¯•ç¯å¢ƒ** | `è„±æ•æ•°æ®` | `ä¸­` | `ä¸­ç­‰` | `æµ‹è¯•å›¢é˜Ÿ` |
| ğŸ­ **é¢„å‘ç¯å¢ƒ** | `ç”Ÿäº§é•œåƒ` | `é«˜` | `æ¥è¿‘ç”Ÿäº§` | `æ ¸å¿ƒå›¢é˜Ÿ` |
| ğŸš€ **ç”Ÿäº§ç¯å¢ƒ** | `çœŸå®æ•°æ®` | `æé«˜` | `å®Œæ•´é…ç½®` | `è¿ç»´å›¢é˜Ÿ` |

### 5.3 GitLab CIå¤šç¯å¢ƒæµæ°´çº¿


```yaml
# .gitlab-ci.yml
stages:
  - build
  - deploy-dev
  - deploy-test
  - deploy-staging
  - deploy-prod

variables:
  DOCKER_IMAGE: "$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA"

# æ„å»ºé˜¶æ®µ
build:
  stage: build
  script:
    - docker build -t $DOCKER_IMAGE .
    - docker push $DOCKER_IMAGE

# å¼€å‘ç¯å¢ƒéƒ¨ç½²
deploy_dev:
  stage: deploy-dev
  script:
    - helm upgrade --install myapp-dev ./helm-chart 
      --set image.tag=$CI_COMMIT_SHA 
      --set env=dev
  environment:
    name: development
    url: https://dev.myapp.com
  only:
    - develop

# æµ‹è¯•ç¯å¢ƒéƒ¨ç½²
deploy_test:
  stage: deploy-test
  script:
    - helm upgrade --install myapp-test ./helm-chart 
      --set image.tag=$CI_COMMIT_SHA 
      --set env=test
  environment:
    name: testing
    url: https://test.myapp.com
  only:
    - develop
  when: manual

# é¢„å‘ç¯å¢ƒéƒ¨ç½²
deploy_staging:
  stage: deploy-staging
  script:
    - helm upgrade --install myapp-staging ./helm-chart 
      --set image.tag=$CI_COMMIT_SHA 
      --set env=staging
  environment:
    name: staging
    url: https://staging.myapp.com
  only:
    - main
  when: manual

# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
deploy_prod:
  stage: deploy-prod
  script:
    - helm upgrade --install myapp-prod ./helm-chart 
      --set image.tag=$CI_COMMIT_SHA 
      --set env=prod
  environment:
    name: production
    url: https://myapp.com
  only:
    - main
  when: manual
  allow_failure: false
```

### 5.4 Jenkinså¤šç¯å¢ƒç®¡ç†


```groovy
pipeline {
    agent any
    
    parameters {
        choice(
            name: 'DEPLOY_ENV',
            choices: ['dev', 'test', 'staging', 'prod'],
            description: 'é€‰æ‹©éƒ¨ç½²ç¯å¢ƒ'
        )
        booleanParam(
            name: 'SKIP_TESTS',
            defaultValue: false,
            description: 'è·³è¿‡æµ‹è¯•'
        )
    }
    
    stages {
        stage('ç¯å¢ƒæ£€æŸ¥') {
            steps {
                script {
                    def env = params.DEPLOY_ENV
                    
                    // ç”Ÿäº§ç¯å¢ƒé¢å¤–æ£€æŸ¥
                    if (env == 'prod') {
                        if (env.BRANCH_NAME != 'main') {
                            error("ç”Ÿäº§ç¯å¢ƒåªèƒ½ä»mainåˆ†æ”¯éƒ¨ç½²")
                        }
                        
                        timeout(time: 5, unit: 'MINUTES') {
                            input message: 'ç¡®è®¤éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Ÿ', 
                                  submitter: 'ops-team'
                        }
                    }
                }
            }
        }
        
        stage('éƒ¨ç½²åº”ç”¨') {
            steps {
                script {
                    def config = [
                        'dev': [replicas: 1, cpu: '100m', memory: '256Mi'],
                        'test': [replicas: 2, cpu: '200m', memory: '512Mi'],
                        'staging': [replicas: 3, cpu: '500m', memory: '1Gi'],
                        'prod': [replicas: 5, cpu: '1000m', memory: '2Gi']
                    ]
                    
                    def envConfig = config[params.DEPLOY_ENV]
                    
                    sh """
                        helm upgrade --install myapp-${params.DEPLOY_ENV} ./helm-chart \\
                            --set image.tag=${BUILD_NUMBER} \\
                            --set env=${params.DEPLOY_ENV} \\
                            --set replicaCount=${envConfig.replicas} \\
                            --set resources.requests.cpu=${envConfig.cpu} \\
                            --set resources.requests.memory=${envConfig.memory}
                    """
                }
            }
        }
    }
}
```

---

## 6. âš™ï¸ ç¯å¢ƒé…ç½®ç®¡ç†


### 6.1 é…ç½®ç®¡ç†æ ¸å¿ƒåŸåˆ™


> ğŸ’¡ **é…ç½®ç®¡ç†çš„"åäºŒè¦ç´ "**  
> - **ä»£ç ä¸é…ç½®åˆ†ç¦»**ï¼šé…ç½®ä¸å†™æ­»åœ¨ä»£ç é‡Œ
> - **ç¯å¢ƒç‰¹å®šé…ç½®**ï¼šæ¯ä¸ªç¯å¢ƒæœ‰è‡ªå·±çš„é…ç½®
> - **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**ï¼šå¯†ç ã€å¯†é’¥å•ç‹¬ç®¡ç†
> - **é…ç½®ç‰ˆæœ¬åŒ–**ï¼šé…ç½®å˜æ›´è¦æœ‰å†å²è®°å½•

```
é…ç½®ç®¡ç†å±‚æ¬¡å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    åº”ç”¨ç¨‹åºä»£ç       â”‚ â† ä¸åŒ…å«é…ç½®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€šç”¨é…ç½®(config)   â”‚ â† æ‰€æœ‰ç¯å¢ƒå…±ç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¯å¢ƒé…ç½®(dev/prod)  â”‚ â† ç¯å¢ƒç‰¹å®šé…ç½®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•æ„Ÿé…ç½®(secrets)  â”‚ â† å¯†ç ã€å¯†é’¥ç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ConfigMapå’ŒSecretç®¡ç†


```yaml
# é€šç”¨é…ç½® - configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  database_host: "mysql.default.svc.cluster.local"
  database_port: "3306"
  redis_host: "redis.default.svc.cluster.local"
  log_level: "info"
  app_debug: "false"

---
# æ•æ„Ÿé…ç½® - secret.yaml  
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
type: Opaque
data:
  database_password: cGFzc3dvcmQxMjM=  # base64ç¼–ç 
  redis_password: cmVkaXNfcGFzcw==
  jwt_secret: and0X3NlY3JldF9rZXk=
```

### 6.3 Helmæ¨¡æ¿åŒ–é…ç½®


```yaml
# values-dev.yaml
environment: development
replicaCount: 1

config:
  database:
    host: dev-mysql
    port: 3306
  log_level: debug
  
resources:
  requests:
    cpu: 100m
    memory: 256Mi

---
# values-prod.yaml  
environment: production
replicaCount: 5

config:
  database:
    host: prod-mysql-cluster
    port: 3306
  log_level: error
  
resources:
  requests:
    cpu: 1000m
    memory: 2Gi
```

### 6.4 Jenkinsé…ç½®ç®¡ç†


```groovy
pipeline {
    agent any
    
    stages {
        stage('åŠ è½½ç¯å¢ƒé…ç½®') {
            steps {
                script {
                    // æ ¹æ®åˆ†æ”¯åŠ è½½ä¸åŒé…ç½®
                    def configFile = "config/${env.BRANCH_NAME}.properties"
                    
                    if (fileExists(configFile)) {
                        def props = readProperties file: configFile
                        env.DATABASE_URL = props.DATABASE_URL
                        env.REDIS_URL = props.REDIS_URL
                        env.LOG_LEVEL = props.LOG_LEVEL
                    }
                    
                    // ä»Jenkinså‡­æ®ç®¡ç†åŠ è½½æ•æ„Ÿä¿¡æ¯
                    withCredentials([
                        string(credentialsId: 'db-password', variable: 'DB_PASSWORD'),
                        string(credentialsId: 'jwt-secret', variable: 'JWT_SECRET')
                    ]) {
                        sh """
                            # ä½¿ç”¨ç¯å¢ƒå˜é‡éƒ¨ç½²
                            envsubst < deployment-template.yaml > deployment.yaml
                            kubectl apply -f deployment.yaml
                        """
                    }
                }
            }
        }
    }
}
```

### 6.5 é…ç½®çƒ­æ›´æ–°æœºåˆ¶


```bash
# é…ç½®æ–‡ä»¶ç›‘æ§è„šæœ¬
#!/bin/bash
# config-watcher.sh

CONFIG_FILE="/etc/app/config.yaml"
LAST_MODIFIED=$(stat -c %Y "$CONFIG_FILE")

while true; do
    CURRENT_MODIFIED=$(stat -c %Y "$CONFIG_FILE")
    
    if [ "$CURRENT_MODIFIED" != "$LAST_MODIFIED" ]; then
        echo "é…ç½®æ–‡ä»¶å·²æ›´æ–°ï¼Œé‡æ–°åŠ è½½..."
        
        # éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
        if yq eval . "$CONFIG_FILE" > /dev/null 2>&1; then
            # å‘é€ä¿¡å·ç»™åº”ç”¨ç¨‹åºé‡æ–°åŠ è½½é…ç½®
            pkill -SIGHUP app-process
            LAST_MODIFIED="$CURRENT_MODIFIED"
            echo "é…ç½®é‡æ–°åŠ è½½æˆåŠŸ"
        else
            echo "é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè·³è¿‡é‡æ–°åŠ è½½"
        fi
    fi
    
    sleep 10
done
```

---

## 7. ğŸ—„ï¸ æ•°æ®åº“è¿ç§»å¤„ç†


### 7.1 æ•°æ®åº“è¿ç§»åŸºæœ¬æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šæ•°æ®åº“è¿ç§»å°±åƒæ¬å®¶ï¼Œè¦ä¿è¯æ¬å®¶è¿‡ç¨‹ä¸­ä¸œè¥¿ä¸ä¸¢ï¼Œæ–°å®¶èƒ½æ­£å¸¸ä½ï¼Œæ—§å®¶è¿˜èƒ½ä¸´æ—¶å›å»ã€‚

```
æ•°æ®åº“è¿ç§»ç­–ç•¥å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åœæœºè¿ç§»       â”‚  â”‚   åœ¨çº¿è¿ç§»       â”‚  â”‚   è“ç»¿è¿ç§»       â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                â”‚
â”‚ åœæ­¢åº”ç”¨        â”‚  â”‚ åŒå†™åŒæ­¥        â”‚  â”‚ æ•°æ®åŒæ­¥        â”‚
â”‚ æ‰§è¡Œè¿ç§»        â”‚  â”‚ é€æ­¥åˆ‡æ¢        â”‚  â”‚ ç¬é—´åˆ‡æ¢        â”‚
â”‚ å¯åŠ¨åº”ç”¨        â”‚  â”‚ éªŒè¯æ•°æ®        â”‚  â”‚ éªŒè¯æ•°æ®        â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                â”‚
â”‚ ç®€å•ï¼Œåœæœºæ—¶é—´é•¿  â”‚  â”‚ å¤æ‚ï¼Œæ— åœæœº     â”‚  â”‚ å¿«é€Ÿï¼Œéœ€åŒå€èµ„æº  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç‰ˆæœ¬åŒ–æ•°æ®åº“è¿ç§»


```sql
-- migrations/001_create_users_table.sql
-- æè¿°ï¼šåˆ›å»ºç”¨æˆ·è¡¨
-- ä½œè€…ï¼šå¼ ä¸‰
-- æ—¥æœŸï¼š2024-01-15

-- å‘å‰è¿ç§»
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);

-- migrations/002_add_user_profile.sql
-- æè¿°ï¼šæ·»åŠ ç”¨æˆ·èµ„æ–™å­—æ®µ
-- ä½œè€…ï¼šæå››  
-- æ—¥æœŸï¼š2024-01-20

ALTER TABLE users 
ADD COLUMN first_name VARCHAR(50),
ADD COLUMN last_name VARCHAR(50),
ADD COLUMN phone VARCHAR(20);
```

### 7.3 Jenkinsæ•°æ®åº“è¿ç§»æµæ°´çº¿


```groovy
pipeline {
    agent any
    
    environment {
        DB_MIGRATION_DIR = "database/migrations"
    }
    
    stages {
        stage('æ•°æ®åº“è¿ç§»å‰æ£€æŸ¥') {
            steps {
                script {
                    // æ£€æŸ¥æ•°æ®åº“è¿æ¥
                    sh """
                        mysql -h \${DB_HOST} -u \${DB_USER} -p\${DB_PASSWORD} \
                              -e "SELECT 1" \${DB_NAME}
                    """
                    
                    // å¤‡ä»½æ•°æ®åº“
                    sh """
                        mysqldump -h \${DB_HOST} -u \${DB_USER} -p\${DB_PASSWORD} \
                                  \${DB_NAME} > backup-\${BUILD_NUMBER}.sql
                    """
                    
                    // æ£€æŸ¥å¾…æ‰§è¡Œçš„è¿ç§»
                    sh """
                        # ä½¿ç”¨Flywayæ£€æŸ¥è¿ç§»çŠ¶æ€
                        flyway -url=jdbc:mysql://\${DB_HOST}:3306/\${DB_NAME} \\
                               -user=\${DB_USER} \\
                               -password=\${DB_PASSWORD} \\
                               -locations=filesystem:\${DB_MIGRATION_DIR} \\
                               info
                    """
                }
            }
        }
        
        stage('æ‰§è¡Œæ•°æ®åº“è¿ç§»') {
            steps {
                script {
                    try {
                        sh """
                            # æ‰§è¡Œæ•°æ®åº“è¿ç§»
                            flyway -url=jdbc:mysql://\${DB_HOST}:3306/\${DB_NAME} \\
                                   -user=\${DB_USER} \\
                                   -password=\${DB_PASSWORD} \\
                                   -locations=filesystem:\${DB_MIGRATION_DIR} \\
                                   migrate
                        """
                    } catch (Exception e) {
                        echo "æ•°æ®åº“è¿ç§»å¤±è´¥ï¼Œå¼€å§‹å›æ»š..."
                        sh """
                            # æ¢å¤æ•°æ®åº“å¤‡ä»½
                            mysql -h \${DB_HOST} -u \${DB_USER} -p\${DB_PASSWORD} \\
                                  \${DB_NAME} < backup-\${BUILD_NUMBER}.sql
                        """
                        throw e
                    }
                }
            }
        }
        
        stage('è¿ç§»åéªŒè¯') {
            steps {
                script {
                    // éªŒè¯è¡¨ç»“æ„
                    sh """
                        mysql -h \${DB_HOST} -u \${DB_USER} -p\${DB_PASSWORD} \\
                              -e "DESCRIBE users" \${DB_NAME}
                    """
                    
                    // éªŒè¯æ•°æ®å®Œæ•´æ€§
                    sh """
                        mysql -h \${DB_HOST} -u \${DB_USER} -p\${DB_PASSWORD} \\
                              -e "SELECT COUNT(*) FROM users" \${DB_NAME}
                    """
                }
            }
        }
    }
    
    post {
        always {
            // æ¸…ç†å¤‡ä»½æ–‡ä»¶ï¼ˆä¿ç•™æœ€è¿‘5ä¸ªï¼‰
            sh "find . -name 'backup-*.sql' | head -n -5 | xargs rm -f || true"
        }
    }
}
```

### 7.4 é›¶åœæœºæ•°æ®åº“è¿ç§»


```bash
#!/bin/bash
# é›¶åœæœºæ•°æ®åº“è¿ç§»è„šæœ¬

echo "å¼€å§‹é›¶åœæœºæ•°æ®åº“è¿ç§»..."

# ç¬¬ä¸€é˜¶æ®µï¼šåˆ›å»ºæ–°è¡¨ç»“æ„ï¼ˆå‘åå…¼å®¹ï¼‰
mysql -e "
    -- åˆ›å»ºæ–°å­—æ®µï¼Œå…è®¸NULL
    ALTER TABLE users ADD COLUMN new_field VARCHAR(100) NULL;
    
    -- åˆ›å»ºæ–°ç´¢å¼•
    CREATE INDEX idx_users_new_field ON users(new_field);
"

# ç¬¬äºŒé˜¶æ®µï¼šåŒå†™æ•°æ®ï¼ˆåº”ç”¨ç¨‹åºåŒæ—¶å†™å…¥æ–°æ—§å­—æ®µï¼‰
echo "ç­‰å¾…åº”ç”¨ç¨‹åºéƒ¨ç½²åŒå†™é€»è¾‘..."
read -p "åº”ç”¨ç¨‹åºå·²æ”¯æŒåŒå†™ï¼ŒæŒ‰å›è½¦ç»§ç»­..."

# ç¬¬ä¸‰é˜¶æ®µï¼šè¿ç§»å†å²æ•°æ®
mysql -e "
    -- æ‰¹é‡æ›´æ–°å†å²æ•°æ®
    UPDATE users 
    SET new_field = CONCAT(first_name, ' ', last_name)
    WHERE new_field IS NULL 
    LIMIT 1000;
"

# æ£€æŸ¥æ•°æ®è¿ç§»è¿›åº¦
while true; do
    REMAINING=$(mysql -sN -e "SELECT COUNT(*) FROM users WHERE new_field IS NULL")
    if [ "$REMAINING" -eq 0 ]; then
        break
    fi
    echo "å‰©ä½™ $REMAINING æ¡æ•°æ®å¾…è¿ç§»..."
    sleep 10
done

# ç¬¬å››é˜¶æ®µï¼šåˆ‡æ¢åˆ°åªè¯»æ–°å­—æ®µ
echo "ç­‰å¾…åº”ç”¨ç¨‹åºåˆ‡æ¢åˆ°æ–°å­—æ®µ..."
read -p "åº”ç”¨ç¨‹åºå·²åˆ‡æ¢ï¼ŒæŒ‰å›è½¦ç»§ç»­..."

# ç¬¬äº”é˜¶æ®µï¼šæ¸…ç†æ—§å­—æ®µï¼ˆå¯é€‰ï¼‰
# mysql -e "ALTER TABLE users DROP COLUMN old_field;"

echo "é›¶åœæœºæ•°æ®åº“è¿ç§»å®Œæˆï¼"
```

---

## 8. ğŸ¥ æœåŠ¡å¥åº·æ£€æŸ¥


### 8.1 å¥åº·æ£€æŸ¥çš„é‡è¦æ€§


**é€šä¿—ç†è§£**ï¼šå¥åº·æ£€æŸ¥å°±åƒç»™æœåŠ¡åšä½“æ£€ï¼Œå®šæœŸæ£€æŸ¥æ˜¯å¦è¿˜æ´»ç€ã€èƒ½æ­£å¸¸å·¥ä½œï¼Œå‘ç°é—®é¢˜åŠæ—¶å¤„ç†ã€‚

```
å¥åº·æ£€æŸ¥å±‚æ¬¡å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å­˜æ´»æ£€æŸ¥(Liveness)  â”‚ â† æœåŠ¡æ˜¯å¦è¿˜æ´»ç€ï¼Ÿ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å°±ç»ªæ£€æŸ¥(Readiness) â”‚ â† æœåŠ¡æ˜¯å¦å‡†å¤‡å¥½æœåŠ¡ï¼Ÿ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯åŠ¨æ£€æŸ¥(Startup)   â”‚ â† æœåŠ¡æ˜¯å¦å¯åŠ¨å®Œæˆï¼Ÿ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Kuberneteså¥åº·æ£€æŸ¥é…ç½®


```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  template:
    spec:
      containers:
      - name: app
        image: myapp:latest
        ports:
        - containerPort: 8080
        
        # å¯åŠ¨æ£€æŸ¥ï¼šåº”ç”¨å¯åŠ¨æ—¶çš„æ£€æŸ¥
        startupProbe:
          httpGet:
            path: /startup
            port: 8080
          initialDelaySeconds: 10  # å¯åŠ¨10ç§’åå¼€å§‹æ£€æŸ¥
          periodSeconds: 5         # æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
          timeoutSeconds: 3        # è¶…æ—¶æ—¶é—´3ç§’
          failureThreshold: 30     # å¤±è´¥30æ¬¡åè®¤ä¸ºå¯åŠ¨å¤±è´¥
        
        # å­˜æ´»æ£€æŸ¥ï¼šè¿è¡ŒæœŸé—´çš„ç”Ÿå‘½æ£€æŸ¥  
        livenessProbe:
          httpGet:
            path: /health/live
            port: 8080
          initialDelaySeconds: 30  # å¯åŠ¨30ç§’åå¼€å§‹æ£€æŸ¥
          periodSeconds: 10        # æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
          timeoutSeconds: 5        # è¶…æ—¶æ—¶é—´5ç§’
          failureThreshold: 3      # è¿ç»­å¤±è´¥3æ¬¡å°±é‡å¯å®¹å™¨
        
        # å°±ç»ªæ£€æŸ¥ï¼šæ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡
        readinessProbe:
          httpGet:
            path: /health/ready
            port: 8080
          initialDelaySeconds: 5   # å¯åŠ¨5ç§’åå¼€å§‹æ£€æŸ¥
          periodSeconds: 5         # æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
          timeoutSeconds: 3        # è¶…æ—¶æ—¶é—´3ç§’
          failureThreshold: 1      # å¤±è´¥1æ¬¡å°±ä»è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤
```

### 8.3 åº”ç”¨ç¨‹åºå¥åº·æ£€æŸ¥ç«¯ç‚¹


```python
# Flaskåº”ç”¨å¥åº·æ£€æŸ¥ç¤ºä¾‹
from flask import Flask, jsonify
import psutil
import redis
import mysql.connector

app = Flask(__name__)

@app.route('/health/live')
def liveness_check():
    """å­˜æ´»æ£€æŸ¥ï¼šæ£€æŸ¥åº”ç”¨æ˜¯å¦è¿˜åœ¨è¿è¡Œ"""
    try:
        # æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
        memory_percent = psutil.virtual_memory().percent
        if memory_percent > 95:
            return jsonify({'status': 'unhealthy', 'reason': 'high_memory'}), 503
            
        return jsonify({'status': 'healthy'})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)}), 503

@app.route('/health/ready')  
def readiness_check():
    """å°±ç»ªæ£€æŸ¥ï¼šæ£€æŸ¥æ˜¯å¦å‡†å¤‡å¥½æœåŠ¡è¯·æ±‚"""
    checks = {}
    overall_status = 'healthy'
    
    # æ£€æŸ¥æ•°æ®åº“è¿æ¥
    try:
        conn = mysql.connector.connect(
            host='mysql', user='app', password='password', database='appdb'
        )
        conn.ping()
        conn.close()
        checks['database'] = 'healthy'
    except Exception as e:
        checks['database'] = f'unhealthy: {str(e)}'
        overall_status = 'unhealthy'
    
    # æ£€æŸ¥Redisè¿æ¥
    try:
        r = redis.Redis(host='redis', port=6379, db=0)
        r.ping()
        checks['redis'] = 'healthy'
    except Exception as e:
        checks['redis'] = f'unhealthy: {str(e)}'
        overall_status = 'unhealthy'
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    disk_usage = psutil.disk_usage('/').percent
    if disk_usage > 90:
        checks['disk'] = f'unhealthy: {disk_usage}% full'
        overall_status = 'unhealthy'
    else:
        checks['disk'] = 'healthy'
    
    status_code = 200 if overall_status == 'healthy' else 503
    return jsonify({
        'status': overall_status,
        'checks': checks
    }), status_code

@app.route('/startup')
def startup_check():
    """å¯åŠ¨æ£€æŸ¥ï¼šæ£€æŸ¥åº”ç”¨æ˜¯å¦å®Œæˆåˆå§‹åŒ–"""
    try:
        # æ£€æŸ¥å¿…è¦çš„é…ç½®æ˜¯å¦åŠ è½½
        if not app.config.get('SECRET_KEY'):
            return jsonify({'status': 'starting', 'reason': 'config_loading'}), 503
            
        # æ£€æŸ¥æ•°æ®åº“è¿ç§»æ˜¯å¦å®Œæˆ
        # ... è¿ç§»æ£€æŸ¥é€»è¾‘ ...
        
        return jsonify({'status': 'ready'})
    except Exception as e:
        return jsonify({'status': 'starting', 'message': str(e)}), 503
```

### 8.4 è´Ÿè½½å‡è¡¡å™¨å¥åº·æ£€æŸ¥


```nginx
# Nginxè´Ÿè½½å‡è¡¡å™¨å¥åº·æ£€æŸ¥é…ç½®
upstream app_servers {
    # æœåŠ¡å™¨é…ç½®
    server app1:8080 max_fails=3 fail_timeout=30s;
    server app2:8080 max_fails=3 fail_timeout=30s;
    server app3:8080 max_fails=3 fail_timeout=30s;
    
    # å¥åº·æ£€æŸ¥é…ç½®ï¼ˆéœ€è¦nginx-plusæˆ–ç¬¬ä¸‰æ–¹æ¨¡å—ï¼‰
    check interval=3000 rise=2 fall=3 timeout=1000 type=http;
    check_http_send "GET /health/ready HTTP/1.0\r\n\r\n";
    check_http_expect_alive http_2xx http_3xx;
}

server {
    listen 80;
    
    location / {
        proxy_pass http://app_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # é”™è¯¯å¤„ç†
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
    }
    
    # å¥åº·æ£€æŸ¥çŠ¶æ€é¡µé¢
    location /nginx_status {
        check_status;
        access_log off;
        allow 127.0.0.1;
        deny all;
    }
}
```

---

## 9. ğŸ”„ å›æ»šæœºåˆ¶é…ç½®


### 9.1 å›æ»šçš„åŸºæœ¬åŸç†


**é€šä¿—ç†è§£**ï¼šå›æ»šå°±åƒç”µè„‘çš„ç³»ç»Ÿè¿˜åŸï¼Œå‡ºç°é—®é¢˜æ—¶å¿«é€Ÿæ¢å¤åˆ°ä¸Šä¸€ä¸ªæ­£å¸¸ç‰ˆæœ¬ï¼Œä¿è¯æœåŠ¡å¿«é€Ÿæ¢å¤ã€‚

```
å›æ»šç­–ç•¥é€‰æ‹©ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¿«é€Ÿå›æ»š       â”‚  â”‚   æ•°æ®å›æ»š       â”‚  â”‚   å®Œæ•´å›æ»š       â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                â”‚
â”‚ åªå›æ»šåº”ç”¨ä»£ç    â”‚  â”‚ åº”ç”¨+æ•°æ®åº“å›æ»š  â”‚  â”‚ åº”ç”¨+æ•°æ®+é…ç½®   â”‚
â”‚ é€Ÿåº¦ï¼šç§’çº§      â”‚  â”‚ é€Ÿåº¦ï¼šåˆ†é’Ÿçº§     â”‚  â”‚ é€Ÿåº¦ï¼šå°æ—¶çº§     â”‚
â”‚ é£é™©ï¼šä½        â”‚  â”‚ é£é™©ï¼šä¸­        â”‚  â”‚ é£é™©ï¼šé«˜        â”‚
â”‚ é€‚ç”¨ï¼šä»£ç Bug   â”‚  â”‚ é€‚ç”¨ï¼šæ•°æ®ç»“æ„å˜æ›´â”‚  â”‚ é€‚ç”¨ï¼šæ¶æ„å˜æ›´   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Kubernetesè‡ªåŠ¨å›æ»š


```yaml
# deployment-with-rollback.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
  annotations:
    deployment.kubernetes.io/revision: "3"  # å½“å‰ç‰ˆæœ¬å·
spec:
  replicas: 3
  revisionHistoryLimit: 10  # ä¿ç•™10ä¸ªå†å²ç‰ˆæœ¬
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  template:
    metadata:
      labels:
        app: myapp
        version: "v2.0"
    spec:
      containers:
      - name: app
        image: myapp:v2.0
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 10
          failureThreshold: 1
```

```bash
# Kuberneteså›æ»šæ“ä½œå‘½ä»¤
# æŸ¥çœ‹éƒ¨ç½²å†å²
kubectl rollout history deployment/myapp

# æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬è¯¦æƒ…  
kubectl rollout history deployment/myapp --revision=2

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/myapp

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
kubectl rollout undo deployment/myapp --to-revision=2

# æ£€æŸ¥å›æ»šçŠ¶æ€
kubectl rollout status deployment/myapp
```

### 9.3 Jenkinsè‡ªåŠ¨å›æ»šæµæ°´çº¿


```groovy
pipeline {
    agent any
    
    parameters {
        choice(
            name: 'ACTION',
            choices: ['deploy', 'rollback'],
            description: 'é€‰æ‹©æ“ä½œç±»å‹'
        )
        string(
            name: 'ROLLBACK_VERSION',
            defaultValue: '',
            description: 'å›æ»šåˆ°çš„ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰'
        )
    }
    
    environment {
        HEALTH_CHECK_URL = "https://myapp.com/health"
        TIMEOUT_MINUTES = "5"
    }
    
    stages {
        stage('éƒ¨ç½²æˆ–å›æ»š') {
            steps {
                script {
                    if (params.ACTION == 'deploy') {
                        // æ­£å¸¸éƒ¨ç½²æµç¨‹
                        deployApplication()
                    } else {
                        // æ‰§è¡Œå›æ»š
                        rollbackApplication()
                    }
                }
            }
        }
        
        stage('éƒ¨ç½²åå¥åº·æ£€æŸ¥') {
            when {
                expression { params.ACTION == 'deploy' }
            }
            steps {
                script {
                    def healthCheckPassed = false
                    def maxRetries = 30
                    
                    for (int i = 0; i < maxRetries; i++) {
                        try {
                            def response = httpRequest(
                                url: env.HEALTH_CHECK_URL,
                                timeout: 10
                            )
                            
                            if (response.status == 200) {
                                echo "å¥åº·æ£€æŸ¥é€šè¿‡"
                                healthCheckPassed = true
                                break
                            }
                        } catch (Exception e) {
                            echo "å¥åº·æ£€æŸ¥å¤±è´¥: ${e.message}"
                        }
                        
                        sleep(10)
                    }
                    
                    if (!healthCheckPassed) {
                        echo "å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»š..."
                        rollbackApplication()
                    }
                }
            }
        }
    }
}

def deployApplication() {
    sh """
        # è®°å½•å½“å‰ç‰ˆæœ¬ç”¨äºå¯èƒ½çš„å›æ»š
        kubectl get deployment myapp -o jsonpath='{.spec.template.spec.containers[0].image}' > previous-version.txt
        
        # éƒ¨ç½²æ–°ç‰ˆæœ¬
        kubectl set image deployment/myapp app=myapp:${BUILD_NUMBER}
        
        # ç­‰å¾…éƒ¨ç½²å®Œæˆ
        kubectl rollout status deployment/myapp --timeout=300s
    """
}

def rollbackApplication() {
    script {
        if (params.ROLLBACK_VERSION) {
            // å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
            sh "kubectl set image deployment/myapp app=myapp:${params.ROLLBACK_VERSION}"
        } else {
            // å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
            if (fileExists('previous-version.txt')) {
                def previousImage = readFile('previous-version.txt').trim()
                sh "kubectl set image deployment/myapp app=${previousImage}"
            } else {
                sh "kubectl rollout undo deployment/myapp"
            }
        }
        
        // ç­‰å¾…å›æ»šå®Œæˆ
        sh "kubectl rollout status deployment/myapp --timeout=300s"
        echo "å›æ»šå®Œæˆ"
    }
}
```

### 9.4 æ•°æ®åº“å›æ»šç­–ç•¥


```bash
#!/bin/bash
# æ•°æ®åº“å®‰å…¨å›æ»šè„šæœ¬

BACKUP_DIR="/backups"
DB_NAME="myapp"
ROLLBACK_TIME="$1"

if [ -z "$ROLLBACK_TIME" ]; then
    echo "ç”¨æ³•: $0 <å›æ»šæ—¶é—´æˆ³> (æ ¼å¼: YYYY-MM-DD_HH-MM-SS)"
    exit 1
fi

echo "å¼€å§‹æ•°æ®åº“å›æ»šåˆ°æ—¶é—´ç‚¹: $ROLLBACK_TIME"

# 1. åˆ›å»ºå½“å‰çŠ¶æ€å¤‡ä»½ï¼ˆä»¥é˜²å›æ»šå¤±è´¥ï¼‰
echo "åˆ›å»ºå½“å‰çŠ¶æ€å¤‡ä»½..."
mysqldump --single-transaction --routines --triggers \
    $DB_NAME > "$BACKUP_DIR/before-rollback-$(date +%Y%m%d_%H%M%S).sql"

# 2. æŸ¥æ‰¾æœ€æ¥è¿‘çš„å¤‡ä»½æ–‡ä»¶
BACKUP_FILE=$(find $BACKUP_DIR -name "*$ROLLBACK_TIME*.sql" | head -1)

if [ -z "$BACKUP_FILE" ]; then
    echo "é”™è¯¯ï¼šæ‰¾ä¸åˆ°æ—¶é—´ç‚¹ $ROLLBACK_TIME çš„å¤‡ä»½æ–‡ä»¶"
    exit 1
fi

echo "ä½¿ç”¨å¤‡ä»½æ–‡ä»¶: $BACKUP_FILE"

# 3. åœæ­¢åº”ç”¨ç¨‹åºï¼ˆé˜²æ­¢æ•°æ®å†™å…¥ï¼‰
echo "åœæ­¢åº”ç”¨ç¨‹åº..."
kubectl scale deployment myapp --replicas=0

# 4. ç­‰å¾…è¿æ¥å…³é—­
sleep 10

# 5. æ¢å¤æ•°æ®åº“
echo "å¼€å§‹æ¢å¤æ•°æ®åº“..."
mysql $DB_NAME < "$BACKUP_FILE"

if [ $? -eq 0 ]; then
    echo "æ•°æ®åº“å›æ»šæˆåŠŸ"
    
    # 6. é‡å¯åº”ç”¨ç¨‹åº
    echo "é‡å¯åº”ç”¨ç¨‹åº..."
    kubectl scale deployment myapp --replicas=3
    
    # 7. ç­‰å¾…åº”ç”¨å¯åŠ¨
    kubectl wait --for=condition=available deployment/myapp --timeout=300s
    
    echo "æ•°æ®åº“å›æ»šå®Œæˆ"
else
    echo "æ•°æ®åº“å›æ»šå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥"
    exit 1
fi
```

### 9.5 è‡ªåŠ¨å›æ»šè§¦å‘æ¡ä»¶


> âš ï¸ **è‡ªåŠ¨å›æ»šè§¦å‘æ¡ä»¶**  
> - **å¥åº·æ£€æŸ¥å¤±è´¥**ï¼šè¶…è¿‡è®¾å®šæ¬¡æ•°çš„å¥åº·æ£€æŸ¥å¤±è´¥
> - **é”™è¯¯ç‡é˜ˆå€¼**ï¼šé”™è¯¯ç‡è¶…è¿‡5%
> - **å“åº”æ—¶é—´å¼‚å¸¸**ï¼šå¹³å‡å“åº”æ—¶é—´è¶…è¿‡æ­£å¸¸æ°´å¹³50%
> - **èµ„æºä½¿ç”¨å¼‚å¸¸**ï¼šCPUæˆ–å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%

```bash
# ç›‘æ§è„šæœ¬ç¤ºä¾‹
#!/bin/bash
# auto-rollback-monitor.sh

DEPLOYMENT_NAME="myapp"
ERROR_THRESHOLD=0.05  # 5%é”™è¯¯ç‡é˜ˆå€¼
RESPONSE_TIME_THRESHOLD=2000  # 2ç§’å“åº”æ—¶é—´é˜ˆå€¼

while true; do
    # æ£€æŸ¥é”™è¯¯ç‡
    ERROR_RATE=$(curl -s "http://prometheus:9090/api/v1/query?query=rate(http_requests_total{status=~\"5.*\"}[5m])" | jq -r '.data.result[0].value[1]')
    
    # æ£€æŸ¥å“åº”æ—¶é—´
    AVG_RESPONSE_TIME=$(curl -s "http://prometheus:9090/api/v1/query?query=histogram_quantile(0.5,rate(http_request_duration_seconds_bucket[5m]))" | jq -r '.data.result[0].value[1]')
    
    # å¦‚æœæŒ‡æ ‡å¼‚å¸¸ï¼Œè§¦å‘è‡ªåŠ¨å›æ»š
    if (( $(echo "$ERROR_RATE > $ERROR_THRESHOLD" | bc -l) )); then
        echo "é”™è¯¯ç‡è¿‡é«˜ ($ERROR_RATE)ï¼Œè§¦å‘è‡ªåŠ¨å›æ»š"
        kubectl rollout undo deployment/$DEPLOYMENT_NAME
        break
    fi
    
    if (( $(echo "$AVG_RESPONSE_TIME > $RESPONSE_TIME_THRESHOLD" | bc -l) )); then
        echo "å“åº”æ—¶é—´è¿‡é•¿ ($AVG_RESPONSE_TIME ms)ï¼Œè§¦å‘è‡ªåŠ¨å›æ»š"
        kubectl rollout undo deployment/$DEPLOYMENT_NAME
        break
    fi
    
    sleep 30
done
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ éƒ¨ç½²ç­–ç•¥é€‰æ‹©ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„éƒ¨ç½²ç­–ç•¥
ğŸ”¸ ç¯å¢ƒç®¡ç†ï¼šå¼€å‘â†’æµ‹è¯•â†’é¢„å‘â†’ç”Ÿäº§çš„ç¯å¢ƒæµè½¬
ğŸ”¸ é…ç½®åˆ†ç¦»ï¼šä»£ç ä¸é…ç½®åˆ†ç¦»ï¼Œç¯å¢ƒç‰¹å®šé…ç½®
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šå¤šå±‚æ¬¡çš„å¥åº·æ£€æŸ¥ä¿éšœæœåŠ¡å¯ç”¨æ€§
ğŸ”¸ å›æ»šæœºåˆ¶ï¼šå¿«é€Ÿæ¢å¤èƒ½åŠ›æ˜¯ç”Ÿäº§ç¯å¢ƒçš„ç”Ÿå‘½çº¿
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ éƒ¨ç½²ç­–ç•¥çš„é€‰æ‹©é€»è¾‘**
```
ä¸šåŠ¡é‡è¦æ€§è¯„ä¼°ï¼š
â€¢ æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿ â†’ è“ç»¿éƒ¨ç½²/é‡‘ä¸é›€å‘å¸ƒ
â€¢ ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿ â†’ æ»šåŠ¨æ›´æ–°
â€¢ å†…éƒ¨å·¥å…·ç³»ç»Ÿ â†’ åœæœºéƒ¨ç½²

èµ„æºæˆæœ¬è€ƒè™‘ï¼š
â€¢ èµ„æºå……è¶³ â†’ è“ç»¿éƒ¨ç½²
â€¢ èµ„æºä¸€èˆ¬ â†’ æ»šåŠ¨æ›´æ–°
â€¢ èµ„æºç´§å¼  â†’ é‡‘ä¸é›€å‘å¸ƒ
```

**ğŸ”¹ ç¯å¢ƒç®¡ç†çš„æœ€ä½³å®è·µ**
```
ç¯å¢ƒä¸€è‡´æ€§åŸåˆ™ï¼š
â€¢ ä½¿ç”¨ç›¸åŒçš„éƒ¨ç½²è„šæœ¬
â€¢ ä¿æŒç¯å¢ƒé…ç½®çš„ä¸€è‡´æ€§
â€¢ æ•°æ®è„±æ•ä½†ç»“æ„ç›¸åŒ

é…ç½®ç®¡ç†åŸåˆ™ï¼š
â€¢ æ•æ„Ÿä¿¡æ¯ä¸æ™®é€šé…ç½®åˆ†ç¦»
â€¢ ç¯å¢ƒç‰¹å®šé…ç½®ç‰ˆæœ¬åŒ–ç®¡ç†
â€¢ æ”¯æŒé…ç½®çƒ­æ›´æ–°
```

**ğŸ”¹ å¥åº·æ£€æŸ¥çš„è®¾è®¡åŸåˆ™**
```
æ£€æŸ¥ç²’åº¦ï¼š
â€¢ å­˜æ´»æ£€æŸ¥ï¼šæ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜æ´»
â€¢ å°±ç»ªæ£€æŸ¥ï¼šæ£€æŸ¥æ˜¯å¦èƒ½æä¾›æœåŠ¡
â€¢ å¯åŠ¨æ£€æŸ¥ï¼šæ£€æŸ¥æ˜¯å¦å®Œæˆåˆå§‹åŒ–

æ£€æŸ¥å†…å®¹ï¼š
â€¢ ä¾èµ–æœåŠ¡è¿æ¥æ€§
â€¢ å…³é”®ä¸šåŠ¡åŠŸèƒ½
â€¢ ç³»ç»Ÿèµ„æºçŠ¶æ€
```

### 10.3 å®è·µæŒ‡å¯¼åŸåˆ™


> ğŸ’¡ **éƒ¨ç½²å®è·µè¦ç‚¹**  
> - **æ¸è¿›å¼å‘å¸ƒ**ï¼šä»å°èŒƒå›´åˆ°å¤§èŒƒå›´
> - **ç›‘æ§é©±åŠ¨**ï¼šåŸºäºæŒ‡æ ‡åšå†³ç­–
> - **å¿«é€Ÿå›æ»š**ï¼šå‡ºç°é—®é¢˜ç«‹å³æ¢å¤
> - **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**ï¼šå‡å°‘äººå·¥æ“ä½œé”™è¯¯

**ğŸ”§ æµæ°´çº¿è®¾è®¡åŸåˆ™**
- **å¹‚ç­‰æ€§**ï¼šé‡å¤æ‰§è¡Œç»“æœç›¸åŒ
- **å¯è§‚æµ‹æ€§**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½æœ‰æ—¥å¿—å’ŒæŒ‡æ ‡
- **å¤±è´¥å¤„ç†**ï¼šé¢„è®¾å¤±è´¥åœºæ™¯çš„å¤„ç†é€»è¾‘
- **äººå·¥å¹²é¢„**ï¼šå…³é”®æ­¥éª¤æ”¯æŒäººå·¥ç¡®è®¤

### 10.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


| é—®é¢˜ç±»å‹ | **å¸¸è§åŸå› ** | **è§£å†³æ–¹æ¡ˆ** | **é¢„é˜²æªæ–½** |
|---------|------------|-------------|-------------|
| ğŸ”¥ **éƒ¨ç½²å¤±è´¥** | `é…ç½®é”™è¯¯ï¼Œä¾èµ–ç¼ºå¤±` | `æ£€æŸ¥é…ç½®ï¼Œæ¢å¤ä¾èµ–` | `ç¯å¢ƒä¸€è‡´æ€§æ£€æŸ¥` |
| âš¡ **æœåŠ¡ä¸å¯ç”¨** | `å¥åº·æ£€æŸ¥å¤±è´¥` | `ç«‹å³å›æ»šä¸Šä¸ªç‰ˆæœ¬` | `å®Œå–„å¥åº·æ£€æŸ¥` |
| ğŸ’¾ **æ•°æ®ä¸¢å¤±** | `è¿ç§»è„šæœ¬é”™è¯¯` | `ä»å¤‡ä»½æ¢å¤æ•°æ®` | `è¿ç§»å‰å¤‡ä»½` |
| ğŸš¦ **æµé‡å¼‚å¸¸** | `è´Ÿè½½å‡è¡¡é…ç½®é”™è¯¯` | `ä¿®æ­£è´Ÿè½½å‡è¡¡é…ç½®` | `ç°åº¦å‘å¸ƒéªŒè¯` |

### 10.5 è¿›é˜¶ä¼˜åŒ–å»ºè®®


**ğŸš€ æ€§èƒ½ä¼˜åŒ–**
- **å¹¶è¡Œéƒ¨ç½²**ï¼šå¤šä¸ªå®ä¾‹å¹¶è¡Œæ›´æ–°
- **é¢„çƒ­æœºåˆ¶**ï¼šæ–°å®ä¾‹å¯åŠ¨åé¢„çƒ­
- **è¿æ¥æ± ç®¡ç†**ï¼šä¼˜é›…å¤„ç†è¿æ¥åˆ‡æ¢

**ğŸ”’ å®‰å…¨åŠ å›º**
- **æƒé™æ§åˆ¶**ï¼šä¸åŒç¯å¢ƒä¸åŒæƒé™
- **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰éƒ¨ç½²æ“ä½œ
- **å¯†é’¥è½®æ¢**ï¼šå®šæœŸæ›´æ–°æ•æ„Ÿé…ç½®

**ğŸ“Š ç›‘æ§å®Œå–„**
- **å…¨é“¾è·¯ç›‘æ§**ï¼šä»è¯·æ±‚åˆ°å“åº”çš„å®Œæ•´é“¾è·¯
- **ä¸šåŠ¡æŒ‡æ ‡**ï¼šå…³æ³¨ä¸šåŠ¡ç›¸å…³çš„æ ¸å¿ƒæŒ‡æ ‡
- **å‘Šè­¦æœºåˆ¶**ï¼šå¼‚å¸¸æƒ…å†µåŠæ—¶é€šçŸ¥

**æ ¸å¿ƒè®°å¿†**ï¼š
- éƒ¨ç½²ç­–ç•¥è¦æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©ï¼Œæ²¡æœ‰ä¸‡èƒ½æ–¹æ¡ˆ
- ç¯å¢ƒç®¡ç†çš„æ ¸å¿ƒæ˜¯ä¸€è‡´æ€§å’Œéš”ç¦»æ€§
- å¥åº·æ£€æŸ¥æ˜¯æœåŠ¡ç¨³å®šæ€§çš„é‡è¦ä¿éšœ
- å¿«é€Ÿå›æ»šèƒ½åŠ›æ˜¯ç”Ÿäº§ç¯å¢ƒçš„å®‰å…¨ç½‘
- è‡ªåŠ¨åŒ–å’Œç›‘æ§æ˜¯ CI/CD æˆåŠŸçš„å…³é”®