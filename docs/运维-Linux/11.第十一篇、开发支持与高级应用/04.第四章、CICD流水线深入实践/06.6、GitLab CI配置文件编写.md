---
title: 6ã€GitLab CIé…ç½®æ–‡ä»¶ç¼–å†™
---
## ğŸ“š ç›®å½•

1. [GitLab CIåŸºç¡€æ¦‚å¿µä¸æ¶æ„](#1-gitlab-ciåŸºç¡€æ¦‚å¿µä¸æ¶æ„)
2. [.gitlab-ci.ymlæ–‡ä»¶ç»“æ„è¯¦è§£](#2-gitlab-ci-ymlæ–‡ä»¶ç»“æ„è¯¦è§£)
3. [Jobå®šä¹‰ä¸Stageé…ç½®å®æˆ˜](#3-jobå®šä¹‰ä¸stageé…ç½®å®æˆ˜)
4. [Scriptè„šæœ¬ç¼–å†™è§„èŒƒä¸æŠ€å·§](#4-scriptè„šæœ¬ç¼–å†™è§„èŒƒä¸æŠ€å·§)
5. [å˜é‡ç³»ç»Ÿæ·±å…¥åº”ç”¨](#5-å˜é‡ç³»ç»Ÿæ·±å…¥åº”ç”¨)
6. [æ¡ä»¶æ‰§è¡Œæ§åˆ¶æœºåˆ¶](#6-æ¡ä»¶æ‰§è¡Œæ§åˆ¶æœºåˆ¶)
7. [é…ç½®å¤ç”¨ä¸ç»§æ‰¿ç­–ç•¥](#7-é…ç½®å¤ç”¨ä¸ç»§æ‰¿ç­–ç•¥)
8. [å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ](#8-å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ GitLab CIåŸºç¡€æ¦‚å¿µä¸æ¶æ„


### 1.1 ä»€ä¹ˆæ˜¯GitLab CI


**GitLab CI**æ˜¯GitLabå†…ç½®çš„**æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²**å·¥å…·ï¼Œå®ƒèƒ½è‡ªåŠ¨åŒ–åœ°æ‰§è¡Œä»£ç æµ‹è¯•ã€æ„å»ºå’Œéƒ¨ç½²ç­‰ä»»åŠ¡ã€‚

**æ ¸å¿ƒç†å¿µ**ï¼š
```
å¼€å‘è€…æäº¤ä»£ç  â†’ è‡ªåŠ¨è§¦å‘æµæ°´çº¿ â†’ æ‰§è¡Œæµ‹è¯•æ„å»º â†’ è‡ªåŠ¨éƒ¨ç½²å‘å¸ƒ
```

**ä¸ºä»€ä¹ˆéœ€è¦CI/CDï¼Ÿ**
- **æ‰‹åŠ¨æ“ä½œå®¹æ˜“å‡ºé”™**ï¼šäººå·¥æµ‹è¯•ã€æ„å»ºã€éƒ¨ç½²å®¹æ˜“é—æ¼æ­¥éª¤
- **æ•ˆç‡ä½ä¸‹**ï¼šæ¯æ¬¡å‘å¸ƒéƒ½è¦é‡å¤ç›¸åŒçš„æ“ä½œ
- **è´¨é‡éš¾ä¿è¯**ï¼šæ²¡æœ‰ç»Ÿä¸€çš„æµ‹è¯•å’Œå‘å¸ƒæ ‡å‡†

### 1.2 GitLab CIæ ¸å¿ƒç»„ä»¶


```
GitLab CI æ¶æ„å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git ä»“åº“   â”‚â”€â”€â”€â–¶â”‚ GitLab CI   â”‚â”€â”€â”€â–¶â”‚ GitLab      â”‚
â”‚ .gitlab-ci  â”‚    â”‚ Pipeline    â”‚    â”‚ Runner      â”‚
â”‚ .ymlé…ç½®    â”‚    â”‚ æµæ°´çº¿      â”‚    â”‚ æ‰§è¡Œå™¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   Job ä»»åŠ¡  â”‚
                   â”‚ Stage é˜¶æ®µ  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š

ğŸ”¸ **Pipelineï¼ˆæµæ°´çº¿ï¼‰**ï¼š
- ä¸€æ¬¡å®Œæ•´çš„CI/CDæ‰§è¡Œè¿‡ç¨‹
- ç”±å¤šä¸ªStageç»„æˆ
- ä»£ç æäº¤æ—¶è‡ªåŠ¨è§¦å‘

ğŸ”¸ **Stageï¼ˆé˜¶æ®µï¼‰**ï¼š
- æµæ°´çº¿ä¸­çš„æ‰§è¡Œé˜¶æ®µ
- åŒä¸€é˜¶æ®µçš„Jobå¹¶è¡Œæ‰§è¡Œ
- å‰ä¸€é˜¶æ®µæˆåŠŸæ‰æ‰§è¡Œä¸‹ä¸€é˜¶æ®µ

ğŸ”¸ **Jobï¼ˆä»»åŠ¡ï¼‰**ï¼š
- å…·ä½“çš„æ‰§è¡Œå•å…ƒ
- åŒ…å«è¦æ‰§è¡Œçš„è„šæœ¬å‘½ä»¤
- è¿è¡Œåœ¨ç‰¹å®šçš„Runnerä¸Š

ğŸ”¸ **Runnerï¼ˆè¿è¡Œå™¨ï¼‰**ï¼š
- å®é™…æ‰§è¡ŒJobçš„æœºå™¨
- å¯ä»¥æ˜¯ç‰©ç†æœºæˆ–Dockerå®¹å™¨
- éœ€è¦æ³¨å†Œåˆ°GitLabå®ä¾‹

### 1.3 æµæ°´çº¿æ‰§è¡Œæµç¨‹


```
å…¸å‹CI/CDæµç¨‹ï¼š

é˜¶æ®µ1ï¼šBuildï¼ˆæ„å»ºï¼‰     é˜¶æ®µ2ï¼šTestï¼ˆæµ‹è¯•ï¼‰      é˜¶æ®µ3ï¼šDeployï¼ˆéƒ¨ç½²ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¼–è¯‘ä»£ç      â”‚â”€â”€â”€â”€â–¶â”‚   å•å…ƒæµ‹è¯•     â”‚â”€â”€â”€â”€â–¶â”‚   éƒ¨ç½²åˆ°æµ‹è¯•   â”‚
â”‚   æ‰“åŒ…åº”ç”¨     â”‚     â”‚   é›†æˆæµ‹è¯•     â”‚     â”‚   éƒ¨ç½²åˆ°ç”Ÿäº§   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚                      â”‚
       â–¼                      â–¼                      â–¼
  æ„å»ºäº§ç‰©ä¿å­˜           æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ             åº”ç”¨æˆåŠŸéƒ¨ç½²
```

---

## 2. ğŸ“‹ .gitlab-ci.ymlæ–‡ä»¶ç»“æ„è¯¦è§£


### 2.1 é…ç½®æ–‡ä»¶åŸºæœ¬ç»“æ„


**.gitlab-ci.yml**æ˜¯GitLab CIçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†æ•´ä¸ªæµæ°´çº¿çš„æ‰§è¡Œé€»è¾‘ã€‚

```yaml
# åŸºæœ¬ç»“æ„ç¤ºä¾‹
stages:
  - build
  - test
  - deploy

variables:
  NODE_VERSION: "16"

before_script:
  - echo "å‡†å¤‡æ‰§è¡Œä»»åŠ¡"

build_job:
  stage: build
  script:
    - npm install
    - npm run build

test_job:
  stage: test
  script:
    - npm test

deploy_job:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åº”ç”¨"
```

### 2.2 æ–‡ä»¶ç»“æ„ç»„æˆè¦ç´ 


**ğŸ”¸ é¡¶å±‚é…ç½®ï¼ˆGlobal Settingsï¼‰**

```yaml
# å…¨å±€é•œåƒè®¾ç½®
image: node:16-alpine

# å…¨å±€æœåŠ¡è®¾ç½®
services:
  - postgres:13

# é˜¶æ®µå®šä¹‰
stages:
  - prepare
  - build
  - test
  - deploy

# å…¨å±€å˜é‡
variables:
  POSTGRES_DB: testdb
  POSTGRES_USER: testuser

# å…¨å±€å‰ç½®è„šæœ¬
before_script:
  - apt-get update -qq
  - apt-get install -y git

# å…¨å±€åç½®è„šæœ¬
after_script:
  - echo "ä»»åŠ¡æ‰§è¡Œå®Œæˆ"
```

**å«ä¹‰è§£é‡Š**ï¼š
- `image`ï¼šæŒ‡å®šJobè¿è¡Œçš„Dockeré•œåƒ
- `services`ï¼šæä¾›é¢å¤–çš„æœåŠ¡å®¹å™¨ï¼ˆå¦‚æ•°æ®åº“ï¼‰
- `stages`ï¼šå®šä¹‰æµæ°´çº¿çš„æ‰§è¡Œé˜¶æ®µå’Œé¡ºåº
- `variables`ï¼šè®¾ç½®ç¯å¢ƒå˜é‡
- `before_script`ï¼šæ¯ä¸ªJobæ‰§è¡Œå‰çš„å‡†å¤‡è„šæœ¬
- `after_script`ï¼šæ¯ä¸ªJobæ‰§è¡Œåçš„æ¸…ç†è„šæœ¬

### 2.3 é…ç½®æ–‡ä»¶è¯­æ³•è§„èŒƒ


**YAMLè¯­æ³•è¦ç‚¹**ï¼š
- **ç¼©è¿›æ•æ„Ÿ**ï¼šä½¿ç”¨ç©ºæ ¼ï¼Œä¸èƒ½ä½¿ç”¨Tab
- **å±‚çº§å…³ç³»**ï¼šé€šè¿‡ç¼©è¿›è¡¨ç¤º
- **åˆ—è¡¨æ ¼å¼**ï¼šä½¿ç”¨`-`å¼€å¤´
- **é”®å€¼å¯¹**ï¼šä½¿ç”¨`key: value`æ ¼å¼

```yaml
# âœ… æ­£ç¡®çš„ç¼©è¿›æ ¼å¼
job_name:
  stage: build
  script:
    - echo "ç¬¬ä¸€ä¸ªå‘½ä»¤"
    - echo "ç¬¬äºŒä¸ªå‘½ä»¤"
  variables:
    ENV: production

# âŒ é”™è¯¯çš„ç¼©è¿›æ ¼å¼
job_name:
stage: build  # ç¼ºå°‘ç¼©è¿›
script:
- echo "å‘½ä»¤"  # ç¼©è¿›ä¸ä¸€è‡´
```

---

## 3. âš™ï¸ Jobå®šä¹‰ä¸Stageé…ç½®å®æˆ˜


### 3.1 Jobçš„å®Œæ•´å®šä¹‰ç»“æ„


**Job**æ˜¯GitLab CIä¸­çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªJobåŒ…å«äº†è¦æ‰§è¡Œçš„å…·ä½“ä»»åŠ¡ã€‚

```yaml
job_name:
  # åŸºæœ¬é…ç½®
  stage: build                    # æ‰€å±é˜¶æ®µ
  image: node:16                  # è¿è¡Œé•œåƒ
  
  # æ‰§è¡Œè„šæœ¬
  script:
    - npm install
    - npm run build
    
  # æ¡ä»¶æ§åˆ¶
  only:
    - master
    - develop
    
  # è¾“å‡ºäº§ç‰©
  artifacts:
    paths:
      - dist/
    expire_in: 1 week
    
  # ç¼“å­˜è®¾ç½®
  cache:
    paths:
      - node_modules/
      
  # æ‰§è¡Œç¯å¢ƒ
  tags:
    - docker
```

**å…³é”®å­—æ®µè¯¦è§£**ï¼š

ğŸ”¸ **stage**ï¼šæŒ‡å®šJobå±äºå“ªä¸ªæ‰§è¡Œé˜¶æ®µ
ğŸ”¸ **script**ï¼šè¦æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ï¼ˆå¿…éœ€å­—æ®µï¼‰
ğŸ”¸ **image**ï¼šJobè¿è¡Œçš„Dockeré•œåƒ
ğŸ”¸ **artifacts**ï¼šä¿å­˜å’Œä¼ é€’çš„æ–‡ä»¶
ğŸ”¸ **cache**ï¼šç¼“å­˜çš„æ–‡ä»¶å’Œç›®å½•
ğŸ”¸ **tags**ï¼šæŒ‡å®šRunneræ ‡ç­¾

### 3.2 Stageé˜¶æ®µé…ç½®ç­–ç•¥


**é˜¶æ®µæ‰§è¡Œç‰¹ç‚¹**ï¼š
- **é¡ºåºæ‰§è¡Œ**ï¼šå‰ä¸€é˜¶æ®µå®Œæˆåæ‰æ‰§è¡Œä¸‹ä¸€é˜¶æ®µ
- **å¹¶è¡Œè¿è¡Œ**ï¼šåŒä¸€é˜¶æ®µå†…çš„Jobå¹¶è¡Œæ‰§è¡Œ
- **å¤±è´¥åœæ­¢**ï¼šä»»ä¸€Jobå¤±è´¥ï¼Œæ•´ä¸ªæµæ°´çº¿åœæ­¢

```yaml
# æ ‡å‡†çš„é˜¶æ®µé…ç½®
stages:
  - prepare      # å‡†å¤‡é˜¶æ®µï¼šç¯å¢ƒæ£€æŸ¥ã€ä¾èµ–å®‰è£…
  - build        # æ„å»ºé˜¶æ®µï¼šä»£ç ç¼–è¯‘ã€æ‰“åŒ…
  - test         # æµ‹è¯•é˜¶æ®µï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•
  - security     # å®‰å…¨é˜¶æ®µï¼šå®‰å…¨æ‰«æã€æ¼æ´æ£€æµ‹
  - deploy       # éƒ¨ç½²é˜¶æ®µï¼šå‘å¸ƒåˆ°å„ç¯å¢ƒ
  - cleanup      # æ¸…ç†é˜¶æ®µï¼šèµ„æºæ¸…ç†ã€é€šçŸ¥

# å®é™…åº”ç”¨ç¤ºä¾‹
prepare_env:
  stage: prepare
  script:
    - echo "æ£€æŸ¥ç¯å¢ƒé…ç½®"
    - node --version
    - npm --version

build_frontend:
  stage: build
  script:
    - npm install
    - npm run build:prod
  artifacts:
    paths:
      - dist/

build_backend:
  stage: build
  script:
    - mvn clean compile
    - mvn package
  artifacts:
    paths:
      - target/*.jar

unit_test:
  stage: test
  script:
    - npm run test:unit
    - mvn test

deploy_staging:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ"
  environment:
    name: staging
    url: https://staging.example.com
```

### 3.3 Jobå¹¶è¡Œä¸ä¾èµ–æ§åˆ¶


**å¹¶è¡Œæ‰§è¡Œç¤ºä¾‹**ï¼š
```yaml
# åŒä¸€é˜¶æ®µçš„å¤šä¸ªJobå¹¶è¡Œæ‰§è¡Œ
test_frontend:
  stage: test
  script:
    - npm run test:frontend

test_backend:
  stage: test
  script:
    - mvn test

test_integration:
  stage: test
  script:
    - npm run test:e2e
```

**ä¾èµ–æ§åˆ¶**ï¼š
```yaml
# ä½¿ç”¨needså…³é”®å­—æŒ‡å®šä¾èµ–å…³ç³»
deploy_job:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åº”ç”¨"
  needs:
    - build_frontend
    - build_backend
  # åªæœ‰æŒ‡å®šçš„JobæˆåŠŸåæ‰æ‰§è¡Œ
```

---

## 4. ğŸ“ Scriptè„šæœ¬ç¼–å†™è§„èŒƒä¸æŠ€å·§


### 4.1 è„šæœ¬ç¼–å†™åŸºæœ¬åŸåˆ™


**Scriptè„šæœ¬**æ˜¯Jobä¸­å®é™…æ‰§è¡Œçš„å‘½ä»¤ï¼Œç¼–å†™æ—¶éœ€è¦éµå¾ªä¸€å®šçš„è§„èŒƒã€‚

```yaml
job_example:
  script:
    # å•è¡Œå‘½ä»¤
    - echo "Hello GitLab CI"
    
    # å¤šè¡Œå‘½ä»¤ï¼ˆä½¿ç”¨ç®¡é“ç¬¦ï¼‰
    - |
      echo "è¿™æ˜¯å¤šè¡Œè„šæœ¬çš„ç¬¬ä¸€è¡Œ"
      echo "è¿™æ˜¯å¤šè¡Œè„šæœ¬çš„ç¬¬äºŒè¡Œ"
      if [ "$CI_COMMIT_BRANCH" = "master" ]; then
        echo "ä¸»åˆ†æ”¯æ„å»º"
      fi
    
    # å¸¦æ¡ä»¶çš„å‘½ä»¤
    - if [ -f package.json ]; then npm install; fi
    
    # è®¾ç½®é”™è¯¯å¤„ç†
    - set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º
    - npm test
```

### 4.2 å¸¸ç”¨è„šæœ¬æ¨¡å¼


**ğŸ”¸ ç¯å¢ƒæ£€æŸ¥è„šæœ¬**ï¼š
```yaml
check_environment:
  script:
    - echo "=== ç¯å¢ƒä¿¡æ¯æ£€æŸ¥ ==="
    - echo "æ“ä½œç³»ç»Ÿ: $(uname -a)"
    - echo "å½“å‰ç”¨æˆ·: $(whoami)"
    - echo "å·¥ä½œç›®å½•: $(pwd)"
    - echo "ç¯å¢ƒå˜é‡: $CI_COMMIT_SHA"
```

**ğŸ”¸ æ„å»ºè„šæœ¬æ¨¡æ¿**ï¼š
```yaml
build_app:
  script:
    - echo "=== å¼€å§‹æ„å»º ==="
    # å®‰è£…ä¾èµ–
    - npm ci --only=production
    
    # æ„å»ºåº”ç”¨
    - npm run build
    
    # éªŒè¯æ„å»ºç»“æœ
    - ls -la dist/
    - echo "æ„å»ºå®Œæˆï¼Œæ–‡ä»¶å¤§å°:"
    - du -sh dist/*
```

**ğŸ”¸ æµ‹è¯•è„šæœ¬æ¨¡æ¿**ï¼š
```yaml
run_tests:
  script:
    - echo "=== æ‰§è¡Œæµ‹è¯• ==="
    # è¿è¡Œå•å…ƒæµ‹è¯•
    - npm run test:unit -- --coverage
    
    # è¿è¡Œé›†æˆæµ‹è¯•
    - npm run test:integration
    
    # ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
    - npm run test:report
  coverage: '/Coverage: \d+\.\d+%/'  # æå–è¦†ç›–ç‡ä¿¡æ¯
```

### 4.3 è„šæœ¬ä¼˜åŒ–æŠ€å·§


**é”™è¯¯å¤„ç†**ï¼š
```yaml
robust_script:
  script:
    # è®¾ç½®é”™è¯¯å¤„ç†
    - set -euo pipefail  # ä¸¥æ ¼æ¨¡å¼
    
    # å‡½æ•°å®šä¹‰
    - |
      cleanup() {
        echo "æ‰§è¡Œæ¸…ç†æ“ä½œ"
        rm -rf temp_files/
      }
      trap cleanup EXIT  # è„šæœ¬é€€å‡ºæ—¶æ‰§è¡Œæ¸…ç†
    
    # ä¸»è¦é€»è¾‘
    - mkdir -p temp_files
    - echo "æ‰§è¡Œä¸»è¦ä»»åŠ¡"
```

**æ—¥å¿—ä¼˜åŒ–**ï¼š
```yaml
verbose_logging:
  script:
    - echo "===================="
    - echo "Job: $CI_JOB_NAME"
    - echo "Stage: $CI_JOB_STAGE" 
    - echo "Commit: $CI_COMMIT_SHA"
    - echo "===================="
    
    # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—
    - echo "[$(date)] å¼€å§‹æ‰§è¡Œæ„å»º"
    - npm run build
    - echo "[$(date)] æ„å»ºå®Œæˆ"
```

---

## 5. ğŸ”§ å˜é‡ç³»ç»Ÿæ·±å…¥åº”ç”¨


### 5.1 å˜é‡ç±»å‹ä¸ä½œç”¨åŸŸ


GitLab CIæä¾›äº†ä¸°å¯Œçš„å˜é‡ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§ç±»å‹å’Œä½œç”¨åŸŸçš„å˜é‡ã€‚

**å˜é‡ç±»å‹åˆ†ç±»**ï¼š

ğŸ”¸ **é¢„å®šä¹‰å˜é‡ï¼ˆCI_*å˜é‡ï¼‰**ï¼š
```yaml
show_ci_variables:
  script:
    - echo "é¡¹ç›®ID: $CI_PROJECT_ID"
    - echo "é¡¹ç›®åç§°: $CI_PROJECT_NAME"
    - echo "åˆ†æ”¯åç§°: $CI_COMMIT_BRANCH"
    - echo "æäº¤å“ˆå¸Œ: $CI_COMMIT_SHA"
    - echo "æäº¤ä¿¡æ¯: $CI_COMMIT_MESSAGE"
    - echo "Jobåç§°: $CI_JOB_NAME"
    - echo "æµæ°´çº¿ID: $CI_PIPELINE_ID"
```

**å¸¸ç”¨CIå˜é‡è¯´æ˜**ï¼š

| å˜é‡å | å«ä¹‰ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `CI_PROJECT_NAME` | é¡¹ç›®åç§° | `my-awesome-app` |
| `CI_COMMIT_BRANCH` | å½“å‰åˆ†æ”¯ | `feature/new-login` |
| `CI_COMMIT_SHA` | æäº¤å“ˆå¸Œ | `a1b2c3d4...` |
| `CI_PIPELINE_ID` | æµæ°´çº¿ID | `12345` |
| `CI_JOB_TOKEN` | Jobè®¤è¯ä»¤ç‰Œ | `glpat-xxx...` |
| `CI_ENVIRONMENT_NAME` | ç¯å¢ƒåç§° | `production` |

### 5.2 è‡ªå®šä¹‰å˜é‡å®šä¹‰


**ğŸ”¸ å…¨å±€å˜é‡å®šä¹‰**ï¼š
```yaml
variables:
  NODE_VERSION: "16.14.0"
  APP_NAME: "my-application"
  DOCKER_REGISTRY: "registry.gitlab.com"
  BUILD_ENV: "production"

# åœ¨Jobä¸­ä½¿ç”¨
build_with_variables:
  script:
    - echo "æ„å»ºåº”ç”¨: $APP_NAME"
    - echo "Nodeç‰ˆæœ¬: $NODE_VERSION"
    - docker build -t $DOCKER_REGISTRY/$APP_NAME:$CI_COMMIT_SHA .
```

**ğŸ”¸ Jobçº§åˆ«å˜é‡**ï¼š
```yaml
development_deploy:
  stage: deploy
  variables:
    DEPLOY_ENV: "development"
    DATABASE_URL: "postgres://dev-db:5432/myapp"
  script:
    - echo "éƒ¨ç½²åˆ°ç¯å¢ƒ: $DEPLOY_ENV"
    - echo "æ•°æ®åº“è¿æ¥: $DATABASE_URL"

production_deploy:
  stage: deploy
  variables:
    DEPLOY_ENV: "production" 
    DATABASE_URL: "postgres://prod-db:5432/myapp"
  script:
    - echo "éƒ¨ç½²åˆ°ç¯å¢ƒ: $DEPLOY_ENV"
    - echo "æ•°æ®åº“è¿æ¥: $DATABASE_URL"
```

### 5.3 å˜é‡é«˜çº§åº”ç”¨


**ğŸ”¸ æ¡ä»¶å˜é‡è®¾ç½®**ï¼š
```yaml
variables:
  # æ ¹æ®åˆ†æ”¯è®¾ç½®ä¸åŒçš„é•œåƒæ ‡ç­¾
  IMAGE_TAG: 
    value: "latest"
    description: "Dockeré•œåƒæ ‡ç­¾"

deploy_job:
  script:
    - |
      if [ "$CI_COMMIT_BRANCH" = "master" ]; then
        export IMAGE_TAG="stable"
      elif [ "$CI_COMMIT_BRANCH" = "develop" ]; then  
        export IMAGE_TAG="dev"
      else
        export IMAGE_TAG="$CI_COMMIT_SHORT_SHA"
      fi
    - echo "ä½¿ç”¨é•œåƒæ ‡ç­¾: $IMAGE_TAG"
    - docker push myapp:$IMAGE_TAG
```

**ğŸ”¸ æ–‡ä»¶å˜é‡**ï¼š
```yaml
variables:
  # ä»æ–‡ä»¶è¯»å–å˜é‡
  CONFIG_FILE: "config/production.env"

load_config:
  script:
    - source $CONFIG_FILE
    - echo "åŠ è½½çš„é…ç½®: $DATABASE_HOST"
```

---

## 6. ğŸ¯ æ¡ä»¶æ‰§è¡Œæ§åˆ¶æœºåˆ¶


### 6.1 only/exceptè§„åˆ™é…ç½®


**only/except**æ˜¯ä¼ ç»Ÿçš„æ¡ä»¶æ‰§è¡Œæ§åˆ¶æ–¹å¼ï¼Œç”¨äºæŒ‡å®šJobåœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ‰§è¡Œæˆ–ä¸æ‰§è¡Œã€‚

**ğŸ”¸ åˆ†æ”¯æ¡ä»¶æ§åˆ¶**ï¼š
```yaml
# åªåœ¨ç‰¹å®šåˆ†æ”¯æ‰§è¡Œ
deploy_production:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"
  only:
    - master
    - main

# åœ¨æ‰€æœ‰åˆ†æ”¯æ‰§è¡Œï¼Œé™¤äº†ç‰¹å®šåˆ†æ”¯
run_tests:
  stage: test
  script:
    - npm test
  except:
    - development
    - experimental
```

**ğŸ”¸ æ ‡ç­¾æ¡ä»¶æ§åˆ¶**ï¼š
```yaml
# åªåœ¨åˆ›å»ºæ ‡ç­¾æ—¶æ‰§è¡Œ
release_build:
  stage: deploy
  script:
    - echo "åˆ›å»ºå‘å¸ƒç‰ˆæœ¬"
    - npm run build:release
  only:
    - tags

# åªåœ¨ç‰¹å®šæ ‡ç­¾æ¨¡å¼æ—¶æ‰§è¡Œ  
hotfix_deploy:
  stage: deploy
  script:
    - echo "çƒ­ä¿®å¤éƒ¨ç½²"
  only:
    - /^hotfix-.*$/  # åŒ¹é…hotfix-å¼€å¤´çš„æ ‡ç­¾
```

**ğŸ”¸ å˜é‡æ¡ä»¶æ§åˆ¶**ï¼š
```yaml
special_job:
  script:
    - echo "ç‰¹æ®Šä»»åŠ¡æ‰§è¡Œ"
  only:
    variables:
      - $CUSTOM_VARIABLE == "special_value"
      - $CI_COMMIT_BRANCH == "feature/new-feature"
```

### 6.2 rulesæ¡ä»¶æ‰§è¡Œæ§åˆ¶


**rules**æ˜¯æ›´ç°ä»£å’Œçµæ´»çš„æ¡ä»¶æ§åˆ¶æ–¹å¼ï¼Œå¯ä»¥æ›¿ä»£only/exceptã€‚

**ğŸ”¸ åŸºæœ¬rulesè¯­æ³•**ï¼š
```yaml
build_job:
  stage: build
  script:
    - npm run build
  rules:
    # è§„åˆ™1ï¼šmasteråˆ†æ”¯æ€»æ˜¯æ‰§è¡Œ
    - if: '$CI_COMMIT_BRANCH == "master"'
      when: always
    
    # è§„åˆ™2ï¼šå¼€å‘åˆ†æ”¯æ‰‹åŠ¨æ‰§è¡Œ
    - if: '$CI_COMMIT_BRANCH == "develop"'
      when: manual
    
    # è§„åˆ™3ï¼šå…¶ä»–æƒ…å†µä¸æ‰§è¡Œ
    - when: never
```

**ğŸ”¸ å¤æ‚æ¡ä»¶ç»„åˆ**ï¼š
```yaml
conditional_deploy:
  stage: deploy
  script:
    - echo "æ¡ä»¶éƒ¨ç½²"
  rules:
    # æ¡ä»¶1ï¼šç”Ÿäº§åˆ†æ”¯ä¸”æœ‰æ ‡ç­¾
    - if: '$CI_COMMIT_BRANCH == "master" && $CI_COMMIT_TAG'
      variables:
        DEPLOY_ENV: "production"
    
    # æ¡ä»¶2ï¼šå¼€å‘åˆ†æ”¯
    - if: '$CI_COMMIT_BRANCH == "develop"'
      variables:
        DEPLOY_ENV: "staging"
    
    # æ¡ä»¶3ï¼šç‰¹æ€§åˆ†æ”¯ä¸”æœ‰ç‰¹å®šæ–‡ä»¶å˜æ›´
    - if: '$CI_COMMIT_BRANCH =~ /^feature\/.*/'
      changes:
        - src/**/*
        - package.json
      when: manual
```

**ğŸ”¸ æ–‡ä»¶å˜æ›´æ£€æµ‹**ï¼š
```yaml
frontend_test:
  stage: test
  script:
    - npm run test:frontend
  rules:
    - changes:
        - frontend/**/*
        - package.json
        - "*.js"
      when: always
    - when: never  # æ²¡æœ‰å‰ç«¯æ–‡ä»¶å˜æ›´æ—¶ä¸æ‰§è¡Œ
```

### 6.3 æ¡ä»¶æ§åˆ¶æœ€ä½³å®è·µ


**åˆ†ç¯å¢ƒéƒ¨ç½²ç­–ç•¥**ï¼š
```yaml
# æµ‹è¯•ç¯å¢ƒè‡ªåŠ¨éƒ¨ç½²
deploy_staging:
  stage: deploy
  script:
    - deploy_to_staging.sh
  rules:
    - if: '$CI_COMMIT_BRANCH == "develop"'

# ç”Ÿäº§ç¯å¢ƒæ‰‹åŠ¨éƒ¨ç½²
deploy_production:
  stage: deploy  
  script:
    - deploy_to_production.sh
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
      when: manual
    - if: '$CI_COMMIT_TAG'
      when: always

# ç‰¹æ€§åˆ†æ”¯é¢„è§ˆéƒ¨ç½²
deploy_preview:
  stage: deploy
  script:
    - deploy_preview.sh
  rules:
    - if: '$CI_MERGE_REQUEST_ID'
      when: manual
  environment:
    name: preview/$CI_MERGE_REQUEST_IID
    url: https://preview-$CI_MERGE_REQUEST_IID.example.com
```

---

## 7. ğŸ”„ é…ç½®å¤ç”¨ä¸ç»§æ‰¿ç­–ç•¥


### 7.1 includeé…ç½®å¤ç”¨


**include**åŠŸèƒ½å…è®¸å°†é…ç½®æ‹†åˆ†åˆ°å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œå®ç°é…ç½®çš„æ¨¡å—åŒ–å’Œå¤ç”¨ã€‚

**ğŸ”¸ æœ¬åœ°æ–‡ä»¶å¼•ç”¨**ï¼š
```yaml
# ä¸»é…ç½®æ–‡ä»¶ .gitlab-ci.yml
include:
  - local: 'ci/build.yml'
  - local: 'ci/test.yml' 
  - local: 'ci/deploy.yml'

stages:
  - build
  - test
  - deploy

variables:
  PROJECT_NAME: "my-app"
```

```yaml
# ci/build.yml
build_frontend:
  stage: build
  script:
    - npm install
    - npm run build
  artifacts:
    paths:
      - dist/

build_backend:
  stage: build
  script:
    - mvn clean package
  artifacts:
    paths:
      - target/*.jar
```

**ğŸ”¸ è¿œç¨‹æ–‡ä»¶å¼•ç”¨**ï¼š
```yaml
include:
  # å¼•ç”¨å…¶ä»–é¡¹ç›®çš„é…ç½®
  - project: 'group/ci-templates'
    ref: master
    file: 'templates/node.yml'
  
  # å¼•ç”¨å…¬å…±æ¨¡æ¿
  - remote: 'https://gitlab.com/my-group/ci-templates/raw/master/docker.yml'
  
  # å¼•ç”¨GitLabå®˜æ–¹æ¨¡æ¿
  - template: 'Security/SAST.gitlab-ci.yml'
```

### 7.2 extendsç»§æ‰¿æœºåˆ¶


**extends**å…³é”®å­—å…è®¸Jobç»§æ‰¿å…¶ä»–Jobæˆ–æ¨¡æ¿çš„é…ç½®ï¼Œå®ç°é…ç½®çš„å¤ç”¨ã€‚

**ğŸ”¸ åŸºç¡€æ¨¡æ¿å®šä¹‰**ï¼š
```yaml
# å®šä¹‰åŸºç¡€Jobæ¨¡æ¿
.base_job:
  image: node:16-alpine
  before_script:
    - npm ci
  cache:
    paths:
      - node_modules/
  tags:
    - docker

.deploy_template:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache curl
  script:
    - echo "æ‰§è¡Œéƒ¨ç½²è„šæœ¬"
```

**ğŸ”¸ ç»§æ‰¿ä¸æ‰©å±•**ï¼š
```yaml
# ç»§æ‰¿åŸºç¡€æ¨¡æ¿
build_app:
  extends: .base_job
  stage: build
  script:
    - npm run build
  artifacts:
    paths:
      - dist/

# ç»§æ‰¿å¹¶è¦†ç›–éƒ¨åˆ†é…ç½®
test_unit:
  extends: .base_job
  stage: test
  script:
    - npm run test:unit
  coverage: '/Coverage: \d+\.\d+%/'

# å¤šé‡ç»§æ‰¿
deploy_staging:
  extends: 
    - .deploy_template
    - .base_job
  script:
    - deploy_staging.sh
  environment:
    name: staging
  rules:
    - if: '$CI_COMMIT_BRANCH == "develop"'
```

### 7.3 é…ç½®å¤ç”¨æœ€ä½³å®è·µ


**ğŸ”¸ é¡¹ç›®ç»“æ„ç»„ç»‡**ï¼š
```
project/
â”œâ”€â”€ .gitlab-ci.yml          # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ ci/
â”‚   â”œâ”€â”€ templates/           # æ¨¡æ¿ç›®å½•
â”‚   â”‚   â”œâ”€â”€ base.yml        # åŸºç¡€æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ build.yml       # æ„å»ºæ¨¡æ¿  
â”‚   â”‚   â””â”€â”€ deploy.yml      # éƒ¨ç½²æ¨¡æ¿
â”‚   â”œâ”€â”€ jobs/               # å…·ä½“Jobé…ç½®
â”‚   â”‚   â”œâ”€â”€ build-jobs.yml
â”‚   â”‚   â”œâ”€â”€ test-jobs.yml
â”‚   â”‚   â””â”€â”€ deploy-jobs.yml
â”‚   â””â”€â”€ variables/          # å˜é‡é…ç½®
â”‚       â”œâ”€â”€ common.yml
â”‚       â””â”€â”€ environments.yml
```

**ğŸ”¸ æ¨¡æ¿åŒ–é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# ci/templates/base.yml
.node_base:
  image: node:16-alpine
  cache:
    key: "$CI_COMMIT_REF_SLUG"
    paths:
      - node_modules/
  before_script:
    - npm ci --cache .npm --prefer-offline

.docker_base:
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY

# ci/jobs/build-jobs.yml  
build_frontend:
  extends: .node_base
  stage: build
  script:
    - npm run build:prod
  artifacts:
    name: "frontend-$CI_COMMIT_SHORT_SHA"
    paths:
      - dist/
    expire_in: 1 week

build_docker:
  extends: .docker_base
  stage: build
  script:
    - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
```

---

## 8. ğŸš€ å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ


### 8.1 å®Œæ•´çš„Node.jsé¡¹ç›®CI/CDé…ç½®


```yaml
# .gitlab-ci.yml
image: node:16-alpine

stages:
  - prepare
  - build
  - test
  - security
  - deploy

variables:
  NODE_ENV: "production"
  DOCKER_REGISTRY: "$CI_REGISTRY_IMAGE"

# å…¨å±€ç¼“å­˜é…ç½®
cache:
  key: "$CI_COMMIT_REF_SLUG"
  paths:
    - node_modules/
    - .npm/

# ç¯å¢ƒå‡†å¤‡
prepare:
  stage: prepare
  script:
    - echo "=== ç¯å¢ƒä¿¡æ¯ ==="
    - node --version
    - npm --version
    - echo "åˆ†æ”¯: $CI_COMMIT_BRANCH"
    - echo "æäº¤: $CI_COMMIT_SHORT_SHA"
  cache:
    policy: push  # åªå†™å…¥ç¼“å­˜

# æ„å»ºåº”ç”¨
build:
  stage: build
  script:
    - npm ci --cache .npm --prefer-offline
    - npm run build
    - echo "æ„å»ºå®Œæˆï¼Œæ£€æŸ¥äº§ç‰©:"
    - ls -la dist/
  artifacts:
    name: "build-$CI_COMMIT_SHORT_SHA"
    paths:
      - dist/
      - package.json
    expire_in: 1 day
  cache:
    policy: pull-push  # è¯»å†™ç¼“å­˜

# å•å…ƒæµ‹è¯•
test:unit:
  stage: test
  script:
    - npm ci --cache .npm --prefer-offline  
    - npm run test:unit
  coverage: '/Coverage: \d+\.\d+%/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml

# é›†æˆæµ‹è¯•
test:integration:
  stage: test
  services:
    - postgres:13
  variables:
    POSTGRES_DB: testdb
    POSTGRES_USER: testuser
    POSTGRES_PASSWORD: testpass
  script:
    - npm ci --cache .npm --prefer-offline
    - npm run test:integration

# å®‰å…¨æ‰«æ
security:audit:
  stage: security
  script:
    - npm audit --audit-level high
  allow_failure: true

# éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
deploy:staging:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ"
    - npm run deploy:staging
  environment:
    name: staging
    url: https://staging.myapp.com
  rules:
    - if: '$CI_COMMIT_BRANCH == "develop"'

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
deploy:production:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"
    - npm run deploy:production
  environment:
    name: production
    url: https://myapp.com
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
      when: manual
    - if: '$CI_COMMIT_TAG'
      when: always
```

### 8.2 å¤šæœåŠ¡é¡¹ç›®é…ç½®


```yaml
# å¾®æœåŠ¡é¡¹ç›®é…ç½®ç¤ºä¾‹
stages:
  - build
  - test
  - security
  - deploy

variables:
  DOCKER_REGISTRY: "$CI_REGISTRY_IMAGE"

# å‰ç«¯æœåŠ¡æ„å»º
build:frontend:
  stage: build
  image: node:16-alpine
  script:
    - cd frontend/
    - npm ci
    - npm run build
  artifacts:
    paths:
      - frontend/dist/
  rules:
    - changes:
        - frontend/**/*

# åç«¯APIæ„å»º
build:api:
  stage: build
  image: maven:3.8-openjdk-17
  script:
    - cd api/
    - mvn clean package
  artifacts:
    paths:
      - api/target/*.jar
  rules:
    - changes:
        - api/**/*

# æ•°æ®åº“æœåŠ¡æ„å»º
build:database:
  stage: build
  image: postgres:13
  script:
    - cd database/
    - echo "éªŒè¯æ•°æ®åº“è„šæœ¬"
    - psql --version
  rules:
    - changes:
        - database/**/*

# å‰ç«¯æµ‹è¯•
test:frontend:
  stage: test
  image: node:16-alpine
  script:
    - cd frontend/
    - npm ci
    - npm run test
  needs: ["build:frontend"]

# APIæµ‹è¯•  
test:api:
  stage: test
  image: maven:3.8-openjdk-17
  services:
    - postgres:13
  variables:
    POSTGRES_DB: testdb
  script:
    - cd api/
    - mvn test
  needs: ["build:api"]

# é›†æˆéƒ¨ç½²
deploy:integrated:
  stage: deploy
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  script:
    - docker-compose -f docker-compose.prod.yml up -d
  environment:
    name: production
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
      when: manual
  needs:
    - build:frontend
    - build:api
    - build:database
```

### 8.3 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**ğŸ”¸ ç¼“å­˜ä¼˜åŒ–ç­–ç•¥**ï¼š
```yaml
# æ™ºèƒ½ç¼“å­˜é…ç½®
cache:
  key: 
    files:
      - package-lock.json  # åŸºäºlockæ–‡ä»¶ç”Ÿæˆç¼“å­˜key
  paths:
    - node_modules/
  policy: pull-push

# åˆ†å±‚ç¼“å­˜
.cache_template:
  cache:
    - key: "npm-cache"
      paths:
        - .npm/
      policy: pull-push
    - key: "node-modules-$CI_COMMIT_REF_SLUG"  
      paths:
        - node_modules/
      policy: pull-push
```

**ğŸ”¸ å¹¶è¡ŒåŒ–ä¼˜åŒ–**ï¼š
```yaml
# ä½¿ç”¨needså®ç°æ›´ç²¾ç»†çš„ä¾èµ–æ§åˆ¶
test:unit:
  stage: test
  script:
    - npm run test:unit
  needs: []  # ä¸ä¾èµ–æ„å»ºï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œ

test:lint:
  stage: test  
  script:
    - npm run lint
  needs: []  # ä¸ä¾èµ–æ„å»ºï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œ

deploy:staging:
  stage: deploy
  script:
    - deploy_to_staging.sh
  needs: 
    - test:unit
    - test:lint
    # åªéœ€è¦æµ‹è¯•é€šè¿‡ï¼Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªtesté˜¶æ®µ
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ GitLab CIæ¶æ„ï¼šPipeline â†’ Stage â†’ Job â†’ Script çš„å±‚æ¬¡ç»“æ„
ğŸ”¸ é…ç½®æ–‡ä»¶ç»“æ„ï¼š.gitlab-ci.ymlçš„åŸºæœ¬è¯­æ³•å’Œç»„ç»‡æ–¹å¼
ğŸ”¸ Jobå®šä¹‰è¦ç´ ï¼šstageã€scriptã€variablesã€rulesç­‰å…³é”®å­—æ®µ
ğŸ”¸ å˜é‡ç³»ç»Ÿï¼šCI_*é¢„å®šä¹‰å˜é‡ã€è‡ªå®šä¹‰å˜é‡ã€ä½œç”¨åŸŸæ§åˆ¶
ğŸ”¸ æ¡ä»¶æ‰§è¡Œï¼šonly/exceptå’Œrulesçš„ä½¿ç”¨åœºæ™¯å’Œè¯­æ³•
ğŸ”¸ é…ç½®å¤ç”¨ï¼šincludeæ–‡ä»¶å¼•ç”¨å’Œextendsç»§æ‰¿æœºåˆ¶
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Pipelineæ‰§è¡Œé€»è¾‘**ï¼š
```
æµæ°´çº¿ç‰¹ç‚¹ï¼š
â€¢ é˜¶æ®µé¡ºåºæ‰§è¡Œï¼šå‰ä¸€é˜¶æ®µæˆåŠŸæ‰æ‰§è¡Œä¸‹ä¸€é˜¶æ®µ
â€¢ Jobå¹¶è¡Œè¿è¡Œï¼šåŒä¸€é˜¶æ®µå†…çš„JobåŒæ—¶æ‰§è¡Œ  
â€¢ å¤±è´¥å³åœæ­¢ï¼šä»»ä½•Jobå¤±è´¥éƒ½ä¼šåœæ­¢æ•´ä¸ªæµæ°´çº¿
â€¢ ä¾èµ–æ§åˆ¶ï¼šé€šè¿‡needså®ç°ç²¾ç¡®çš„ä¾èµ–å…³ç³»
```

**ğŸ”¹ å˜é‡ä¼˜å…ˆçº§**ï¼š
```
å˜é‡ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. Jobçº§åˆ«å˜é‡
2. Pipelineçº§åˆ«å˜é‡
3. é¡¹ç›®è®¾ç½®ä¸­çš„å˜é‡
4. ç»„è®¾ç½®ä¸­çš„å˜é‡
5. å®ä¾‹è®¾ç½®ä¸­çš„å˜é‡
6. é¢„å®šä¹‰CIå˜é‡
```

**ğŸ”¹ æ¡ä»¶æ§åˆ¶é€‰æ‹©**ï¼š
```
ä½¿ç”¨åœºæ™¯å¯¹æ¯”ï¼š
â€¢ only/exceptï¼šç®€å•çš„åˆ†æ”¯/æ ‡ç­¾æ§åˆ¶
â€¢ rulesï¼šå¤æ‚æ¡ä»¶é€»è¾‘ã€æ–‡ä»¶å˜æ›´æ£€æµ‹
â€¢ whenï¼šæ§åˆ¶Jobæ‰§è¡Œæ—¶æœºï¼ˆalways/manual/neverï¼‰
â€¢ needsï¼šä¼˜åŒ–æ‰§è¡Œä¾èµ–ï¼Œæå‡å¹¶è¡Œåº¦
```

### 9.3 å®è·µæŒ‡å¯¼åŸåˆ™


**é…ç½®æ–‡ä»¶ç»„ç»‡**ï¼š
- **æ¨¡å—åŒ–åˆ†ç¦»**ï¼šå°†é…ç½®æŒ‰åŠŸèƒ½æ‹†åˆ†åˆ°ä¸åŒæ–‡ä»¶
- **æ¨¡æ¿åŒ–å¤ç”¨**ï¼šæŠ½å–é€šç”¨é…ç½®ä¸ºå¯å¤ç”¨æ¨¡æ¿
- **ç¯å¢ƒéš”ç¦»**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®å’Œå˜é‡
- **å®‰å…¨ç¬¬ä¸€**ï¼šæ•æ„Ÿä¿¡æ¯ä½¿ç”¨GitLabå˜é‡ï¼Œä¸å†™å…¥ä»£ç 

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š
- **æ™ºèƒ½ç¼“å­˜**ï¼šåŸºäºä¾èµ–æ–‡ä»¶ç”Ÿæˆç¼“å­˜key
- **å¹¶è¡Œæ‰§è¡Œ**ï¼šåˆ©ç”¨needsä¼˜åŒ–Jobä¾èµ–å…³ç³»
- **æ¡ä»¶æ‰§è¡Œ**ï¼šåªåœ¨å¿…è¦æ—¶è¿è¡ŒJobï¼Œé¿å…æµªè´¹èµ„æº
- **äº§ç‰©ç®¡ç†**ï¼šåˆç†è®¾ç½®artifactsçš„è¿‡æœŸæ—¶é—´

**è°ƒè¯•ä¸ç»´æŠ¤**ï¼š
- **è¯¦ç»†æ—¥å¿—**ï¼šåœ¨è„šæœ¬ä¸­æ·»åŠ æ¸…æ™°çš„æ—¥å¿—è¾“å‡º
- **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨set -eç­‰æ–¹å¼å¤„ç†è„šæœ¬é”™è¯¯
- **æµ‹è¯•ä¼˜å…ˆ**ï¼šåœ¨æœ¬åœ°éªŒè¯é…ç½®åå†æäº¤
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šé…ç½®æ–‡ä»¶çš„ä¿®æ”¹è¦æœ‰æ¸…æ™°çš„æäº¤ä¿¡æ¯

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
GitLab CIé…ç½®æœ‰ç« æ³•ï¼Œyamlè¯­æ³•è¦è§„èŒƒ
Pipeline Stage Jobå±‚æ¬¡æ¸…ï¼Œscriptè„šæœ¬æ˜¯æ ¸å¿ƒ
å˜é‡ç³»ç»Ÿå¾ˆå¼ºå¤§ï¼ŒCIå¼€å¤´æ˜¯å†…ç½®
æ¡ä»¶æ§åˆ¶ç”¨rulesï¼Œincludeå¤ç”¨æ˜¾ç¥é€š
extendsç»§æ‰¿çœä»£ç ï¼Œæ¨¡æ¿å¤ç”¨æ•ˆç‡é«˜
```