---
title: 13ã€æµæ°´çº¿ç›‘æ§ä¸æ—¥å¿—ç®¡ç†
---
## ğŸ“š ç›®å½•


1. [æµæ°´çº¿ç›‘æ§åŸºç¡€æ¦‚å¿µ](#1-æµæ°´çº¿ç›‘æ§åŸºç¡€æ¦‚å¿µ)
2. [æ„å»ºçŠ¶æ€ç›‘æ§](#2-æ„å»ºçŠ¶æ€ç›‘æ§)
3. [æµæ°´çº¿æ€§èƒ½æŒ‡æ ‡æ”¶é›†](#3-æµæ°´çº¿æ€§èƒ½æŒ‡æ ‡æ”¶é›†)
4. [æ„å»ºæ—¥å¿—ç®¡ç†](#4-æ„å»ºæ—¥å¿—ç®¡ç†)
5. [å‘Šè­¦é€šçŸ¥é…ç½®](#5-å‘Šè­¦é€šçŸ¥é…ç½®)
6. [æ„å»ºå†å²åˆ†æ](#6-æ„å»ºå†å²åˆ†æ)
7. [å¤±è´¥åŸå› ç»Ÿè®¡](#7-å¤±è´¥åŸå› ç»Ÿè®¡)
8. [æµæ°´çº¿å¯è§†åŒ–å±•ç¤º](#8-æµæ°´çº¿å¯è§†åŒ–å±•ç¤º)
9. [è¿ç»´æ•°æ®æŠ¥è¡¨](#9-è¿ç»´æ•°æ®æŠ¥è¡¨)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ è·¯å¾„å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦æŒæ¡Jenkins/GitLab CIåŸºç¡€ã€Shellè„šæœ¬ã€ç›‘æ§åŸç† â†’ **å½“å‰å†…å®¹**ï¼šæµæ°´çº¿ç›‘æ§ä¸æ—¥å¿—ç®¡ç† â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ DevOpsè¿ç»´è‡ªåŠ¨åŒ–

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡90åˆ†é’Ÿ | å®è·µé…ç½®60åˆ†é’Ÿ

ğŸ·ï¸ **çŸ¥è¯†æ ‡ç­¾**ï¼š`#ç›‘æ§è¿ç»´` `#æ—¥å¿—ç®¡ç†` `#æ€§èƒ½ä¼˜åŒ–` `#å‘Šè­¦é€šçŸ¥`

---

## 1. ğŸ” æµæ°´çº¿ç›‘æ§åŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯æµæ°´çº¿ç›‘æ§



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
æµæ°´çº¿ç›‘æ§æ˜¯å¯¹CI/CDæµæ°´çº¿è¿è¡ŒçŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡ã€æ‰§è¡Œç»“æœè¿›è¡Œå®æ—¶è·Ÿè¸ªå’Œåˆ†æçš„è¿‡ç¨‹ã€‚

**ğŸ’¡ é€šä¿—ç†è§£**
å°±åƒå·¥å‚çš„ç”Ÿäº§çº¿ç®¡ç†ä¸€æ ·ï¼š
- **ç”Ÿäº§çº¿çŠ¶æ€**ï¼šæœºå™¨æ˜¯å¦æ­£å¸¸è¿è½¬
- **ç”Ÿäº§æ•ˆç‡**ï¼šæ¯å°æ—¶èƒ½ç”Ÿäº§å¤šå°‘äº§å“
- **è´¨é‡æ£€æŸ¥**ï¼šäº§å“åˆæ ¼ç‡å¦‚ä½•
- **é—®é¢˜é¢„è­¦**ï¼šè®¾å¤‡æ•…éšœåŠæ—¶å‘ç°

åœ¨CI/CDä¸­ï¼š
- **æ„å»ºçŠ¶æ€**ï¼šæµæ°´çº¿æ˜¯å¦æˆåŠŸæ‰§è¡Œ
- **æ„å»ºæ•ˆç‡**ï¼šæ¯æ¬¡æ„å»ºèŠ±è´¹å¤šå°‘æ—¶é—´
- **ä»£ç è´¨é‡**ï¼šæµ‹è¯•è¦†ç›–ç‡ã€ä»£ç æ£€æŸ¥ç»“æœ
- **å¼‚å¸¸å‘Šè­¦**ï¼šæ„å»ºå¤±è´¥ã€æ€§èƒ½ä¸‹é™æé†’

### 1.2 ç›‘æ§çš„é‡è¦ä»·å€¼



**ğŸ¯ æ ¸å¿ƒä»·å€¼ä½“ç°**

| ä»·å€¼ç»´åº¦ | **å…·ä½“ä½“ç°** | **ä¸šåŠ¡å½±å“** |
|---------|-------------|-------------|
| **åŠæ—¶å‘ç°é—®é¢˜** | æ„å»ºå¤±è´¥ç«‹å³æ„ŸçŸ¥ | é¿å…å»¶è¯¯å‘å¸ƒè®¡åˆ’ |
| **ä¼˜åŒ–æµæ°´çº¿æ€§èƒ½** | è¯†åˆ«è€—æ—¶é•¿çš„æ­¥éª¤ | æå‡å¼€å‘æ•ˆç‡ |
| **ä¿éšœä»£ç è´¨é‡** | ç›‘æ§æµ‹è¯•è¦†ç›–ç‡ | å‡å°‘çº¿ä¸Šæ•…éšœ |
| **æ•°æ®é©±åŠ¨å†³ç­–** | åŸºäºç»Ÿè®¡æ•°æ®ä¼˜åŒ– | æŒç»­æ”¹è¿›æµç¨‹ |

### 1.3 ç›‘æ§ä½“ç³»æ¶æ„



**ğŸ—ï¸ ç›‘æ§ç³»ç»Ÿå…¨æ™¯**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç›‘æ§æ•°æ®æ”¶é›†å±‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ„å»ºçŠ¶æ€ç›‘æ§   â”‚   æ€§èƒ½æŒ‡æ ‡ç›‘æ§   â”‚   æ—¥å¿—æ•°æ®ç›‘æ§   â”‚
â”‚   âœ“ æˆåŠŸ/å¤±è´¥   â”‚   âœ“ æ‰§è¡Œæ—¶é—´    â”‚   âœ“ æ„å»ºæ—¥å¿—    â”‚
â”‚   âœ“ è¿è¡Œé˜¶æ®µ    â”‚   âœ“ èµ„æºå ç”¨    â”‚   âœ“ é”™è¯¯ä¿¡æ¯    â”‚
â”‚   âœ“ è§¦å‘æºå¤´    â”‚   âœ“ é˜Ÿåˆ—çŠ¶æ€    â”‚   âœ“ æµ‹è¯•æŠ¥å‘Š    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ•°æ®å¤„ç†åˆ†æå±‚                       â”‚
â”‚   â€¢ æ•°æ®èšåˆ     â€¢ è¶‹åŠ¿åˆ†æ     â€¢ å¼‚å¸¸æ£€æµ‹           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å±•ç¤ºå‘Šè­¦è¾“å‡ºå±‚                       â”‚
â”‚   â€¢ å®æ—¶ä»ªè¡¨æ¿   â€¢ å†å²æŠ¥è¡¨     â€¢ å‘Šè­¦é€šçŸ¥           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“Š æ„å»ºçŠ¶æ€ç›‘æ§



### 2.1 Jenkinsæ„å»ºçŠ¶æ€ç›‘æ§



**ğŸ”§ JenkinsçŠ¶æ€APIä½¿ç”¨**

Jenkinsæä¾›äº†ä¸°å¯Œçš„REST APIæ¥è·å–æ„å»ºçŠ¶æ€ä¿¡æ¯ï¼š

```bash
# è·å–ä»»åŠ¡åŸºæœ¬ä¿¡æ¯

curl -s "http://jenkins-server/job/my-project/api/json" | jq '.lastBuild'

# è·å–å…·ä½“æ„å»ºè¯¦æƒ…

curl -s "http://jenkins-server/job/my-project/123/api/json" | jq '.result'
```

**ğŸ“‹ å…³é”®çŠ¶æ€å­—æ®µå«ä¹‰**
- **SUCCESS**ï¼šæ„å»ºæˆåŠŸå®Œæˆ
- **FAILURE**ï¼šæ„å»ºå¤±è´¥ï¼ˆä»£ç é—®é¢˜ã€æµ‹è¯•ä¸é€šè¿‡ç­‰ï¼‰
- **UNSTABLE**ï¼šæ„å»ºå®Œæˆä½†æœ‰è­¦å‘Šï¼ˆéƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼‰
- **ABORTED**ï¼šæ„å»ºè¢«æ‰‹åŠ¨ç»ˆæ­¢
- **null**ï¼šæ„å»ºæ­£åœ¨è¿›è¡Œä¸­

### 2.2 çŠ¶æ€ç›‘æ§è„šæœ¬å®ç°



**ğŸ” è‡ªåŠ¨åŒ–çŠ¶æ€æ£€æŸ¥**
```bash
#!/bin/bash

# Jenkinsæ„å»ºçŠ¶æ€ç›‘æ§è„šæœ¬


JENKINS_URL="http://jenkins-server"
JOB_NAME="my-project"
WEBHOOK_URL="your-notification-webhook"

check_build_status() {
    local job_url="${JENKINS_URL}/job/${JOB_NAME}"
    
#    # è·å–æœ€æ–°æ„å»ºä¿¡æ¯
    local build_info=$(curl -s "${job_url}/lastBuild/api/json")
    local build_number=$(echo "$build_info" | jq -r '.number')
    local build_result=$(echo "$build_info" | jq -r '.result')
    local build_duration=$(echo "$build_info" | jq -r '.duration')
    
    echo "ğŸ” æ£€æŸ¥æ„å»ºçŠ¶æ€..."
    echo "   æ„å»ºç¼–å·: #$build_number"
    echo "   æ„å»ºç»“æœ: $build_result"
    echo "   æ‰§è¡Œæ—¶é•¿: $((build_duration / 1000))ç§’"
    
#    # æ ¹æ®çŠ¶æ€é‡‡å–ç›¸åº”è¡ŒåŠ¨
    case "$build_result" in
        "SUCCESS")
            echo "âœ… æ„å»ºæˆåŠŸ"
            ;;
        "FAILURE")
            echo "âŒ æ„å»ºå¤±è´¥ï¼Œå‘é€å‘Šè­¦"
            send_failure_alert "$build_number"
            ;;
        "UNSTABLE")
            echo "âš ï¸ æ„å»ºä¸ç¨³å®š"
            ;;
        "null")
            echo "ğŸ”„ æ„å»ºè¿›è¡Œä¸­"
            ;;
    esac
}

send_failure_alert() {
    local build_num="$1"
    local message="ğŸš¨ Jenkinsæ„å»ºå¤±è´¥è­¦å‘Š
é¡¹ç›®: $JOB_NAME
æ„å»º: #$build_num
æ—¶é—´: $(date)
æŸ¥çœ‹: ${JENKINS_URL}/job/${JOB_NAME}/$build_num"
    
#    # å‘é€åˆ°å›¢é˜Ÿé€šçŸ¥æ¸ é“
    curl -X POST "$WEBHOOK_URL" \
         -H "Content-Type: application/json" \
         -d "{\"text\":\"$message\"}"
}
```

### 2.3 GitLab CIçŠ¶æ€ç›‘æ§



**ğŸ¦Š GitLab CI Pipelineç›‘æ§**

GitLabæä¾›äº†PipelineçŠ¶æ€çš„APIæ¥å£ï¼š

```bash
# è·å–é¡¹ç›®çš„Pipelineåˆ—è¡¨

curl --header "PRIVATE-TOKEN: your-token" \
     "https://gitlab.com/api/v4/projects/123/pipelines"

# è·å–ç‰¹å®šPipelineçŠ¶æ€

curl --header "PRIVATE-TOKEN: your-token" \
     "https://gitlab.com/api/v4/projects/123/pipelines/456"
```

**ğŸ“Š PipelineçŠ¶æ€å«ä¹‰**
- **running**ï¼šæµæ°´çº¿æ­£åœ¨æ‰§è¡Œ
- **pending**ï¼šç­‰å¾…æ‰§è¡Œ
- **success**ï¼šæ‰§è¡ŒæˆåŠŸ
- **failed**ï¼šæ‰§è¡Œå¤±è´¥
- **canceled**ï¼šè¢«å–æ¶ˆ
- **skipped**ï¼šè¢«è·³è¿‡

---

## 3. âš¡ æµæ°´çº¿æ€§èƒ½æŒ‡æ ‡æ”¶é›†



### 3.1 å…³é”®æ€§èƒ½æŒ‡æ ‡å®šä¹‰



**ğŸ“ˆ æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ï¼ˆKPIï¼‰**

| æŒ‡æ ‡åç§° | **å«ä¹‰è¯´æ˜** | **æ­£å¸¸èŒƒå›´** | **ä¼˜åŒ–ç›®æ ‡** |
|---------|-------------|-------------|-------------|
| **æ„å»ºæ—¶é•¿** | ä»è§¦å‘åˆ°å®Œæˆçš„æ€»æ—¶é—´ | 5-15åˆ†é’Ÿ | è¶ŠçŸ­è¶Šå¥½ |
| **é˜Ÿåˆ—ç­‰å¾…æ—¶é—´** | æ„å»ºåœ¨é˜Ÿåˆ—ä¸­çš„ç­‰å¾…æ—¶é•¿ | < 2åˆ†é’Ÿ | æ¥è¿‘0 |
| **æˆåŠŸç‡** | æˆåŠŸæ„å»ºæ•° / æ€»æ„å»ºæ•° | > 85% | æ¥è¿‘100% |
| **å¹³å‡ä¿®å¤æ—¶é—´** | ä»å¤±è´¥åˆ°ä¿®å¤çš„å¹³å‡æ—¶é—´ | < 30åˆ†é’Ÿ | è¶ŠçŸ­è¶Šå¥½ |
| **éƒ¨ç½²é¢‘ç‡** | æ¯å¤©/å‘¨çš„éƒ¨ç½²æ¬¡æ•° | æ ¹æ®å›¢é˜Ÿè§„æ¨¡ | æŒç»­äº¤ä»˜ |

### 3.2 æ€§èƒ½æ•°æ®æ”¶é›†å®ç°



**ğŸ“Š Jenkinsæ€§èƒ½ç›‘æ§æ’ä»¶é…ç½®**

é€šè¿‡Jenkinsçš„Build Time Trendæ’ä»¶å¯ä»¥æ”¶é›†æ€§èƒ½æ•°æ®ï¼š

```groovy
// Jenkinsfileä¸­æ·»åŠ æ€§èƒ½æ”¶é›†
pipeline {
    agent any
    
    stages {
        stage('Performance Monitoring') {
            steps {
                script {
                    // è®°å½•æ„å»ºå¼€å§‹æ—¶é—´
                    env.BUILD_START_TIME = sh(
                        script: 'date +%s',
                        returnStdout: true
                    ).trim()
                }
            }
        }
        
        stage('Build') {
            steps {
                // æ„å»ºæ­¥éª¤
                sh 'make build'
            }
        }
        
        stage('Test') {
            steps {
                // æµ‹è¯•æ­¥éª¤
                sh 'make test'
            }
        }
    }
    
    post {
        always {
            script {
                // è®¡ç®—æ„å»ºæ€»æ—¶é•¿
                def buildEndTime = sh(
                    script: 'date +%s',
                    returnStdout: true
                ).trim() as Integer
                def buildStartTime = env.BUILD_START_TIME as Integer
                def buildDuration = buildEndTime - buildStartTime
                
                // è®°å½•æ€§èƒ½æ•°æ®
                writeFile file: 'build-metrics.json', text: """
                {
                    "buildNumber": ${BUILD_NUMBER},
                    "duration": ${buildDuration},
                    "timestamp": ${buildEndTime},
                    "result": "${currentBuild.result ?: 'SUCCESS'}"
                }
                """
                
                // å½’æ¡£æ€§èƒ½æ•°æ®
                archiveArtifacts artifacts: 'build-metrics.json'
            }
        }
    }
}
```

### 3.3 èµ„æºä½¿ç”¨ç›‘æ§



**ğŸ’» ç³»ç»Ÿèµ„æºç›‘æ§è„šæœ¬**
```bash
#!/bin/bash

# CI/CDç³»ç»Ÿèµ„æºç›‘æ§


monitor_system_resources() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    local memory_usage=$(free | grep Mem | awk '{printf "%.1f", $3/$2 * 100.0}')
    local disk_usage=$(df -h / | tail -1 | awk '{print $5}' | cut -d'%' -f1)
    
#    # è®°å½•åˆ°ç›‘æ§æ—¥å¿—
    echo "$timestamp,CPU:${cpu_usage}%,Memory:${memory_usage}%,Disk:${disk_usage}%" \
        >> /var/log/ci-system-monitor.log
    
#    # æ£€æŸ¥èµ„æºä½¿ç”¨æ˜¯å¦è¿‡é«˜
    if (( $(echo "$cpu_usage > 80" | bc -l) )); then
        echo "âš ï¸ CPUä½¿ç”¨ç‡è¿‡é«˜: ${cpu_usage}%"
    fi
    
    if (( $(echo "$memory_usage > 85" | bc -l) )); then
        echo "âš ï¸ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${memory_usage}%"
    fi
    
    if [[ $disk_usage -gt 90 ]]; then
        echo "âš ï¸ ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: ${disk_usage}%"
    fi
}

# æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§

while true; do
    monitor_system_resources
    sleep 60
done
```

---

## 4. ğŸ“ æ„å»ºæ—¥å¿—ç®¡ç†



### 4.1 æ—¥å¿—æ”¶é›†ç­–ç•¥



**ğŸ“‹ æ—¥å¿—åˆ†ç±»ç®¡ç†**

æ„å»ºè¿‡ç¨‹äº§ç”Ÿçš„æ—¥å¿—å¯ä»¥åˆ†ä¸ºå‡ ä¸ªå±‚æ¬¡ï¼š

```
æ„å»ºæ—¥å¿—å±‚æ¬¡ç»“æ„:
â”œâ”€â”€ ç³»ç»Ÿçº§æ—¥å¿—
â”‚   â”œâ”€â”€ Jenkins masteræ—¥å¿—
â”‚   â”œâ”€â”€ AgentèŠ‚ç‚¹æ—¥å¿—  
â”‚   â””â”€â”€ ç³»ç»Ÿèµ„æºæ—¥å¿—
â”œâ”€â”€ é¡¹ç›®çº§æ—¥å¿—
â”‚   â”œâ”€â”€ æ„å»ºæ‰§è¡Œæ—¥å¿—
â”‚   â”œâ”€â”€ æµ‹è¯•è¿è¡Œæ—¥å¿—
â”‚   â””â”€â”€ éƒ¨ç½²æ“ä½œæ—¥å¿—
â””â”€â”€ åº”ç”¨çº§æ—¥å¿—
    â”œâ”€â”€ å•å…ƒæµ‹è¯•è¾“å‡º
    â”œâ”€â”€ ä»£ç è´¨é‡æ£€æŸ¥
    â””â”€â”€ å®‰å…¨æ‰«ææŠ¥å‘Š
```

### 4.2 æ—¥å¿—æ ‡å‡†åŒ–æ ¼å¼



**ğŸ“„ ç»“æ„åŒ–æ—¥å¿—æ ¼å¼è®¾è®¡**

ä¸ºäº†ä¾¿äºæ—¥å¿—åˆ†æï¼Œå»ºè®®ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼ï¼š

```bash
# æ—¥å¿—æ ¼å¼æ ‡å‡†

log_format() {
    local level="$1"    # INFO/WARN/ERROR
    local stage="$2"    # BUILD/TEST/DEPLOY
    local message="$3"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    echo "[$timestamp] [$level] [$stage] $message"
}

# ä½¿ç”¨ç¤ºä¾‹

log_format "INFO" "BUILD" "å¼€å§‹ç¼–è¯‘æºä»£ç "
log_format "ERROR" "TEST" "å•å…ƒæµ‹è¯•å¤±è´¥: test_user_login"
log_format "WARN" "DEPLOY" "ç›®æ ‡æœåŠ¡å™¨å“åº”ç¼“æ…¢"
```

### 4.3 æ—¥å¿—å­˜å‚¨å’Œè½®è½¬



**ğŸ—„ï¸ æ—¥å¿—ç®¡ç†æœ€ä½³å®è·µ**

```bash
#!/bin/bash

# æ„å»ºæ—¥å¿—ç®¡ç†è„šæœ¬


LOG_DIR="/var/log/ci-builds"
MAX_LOG_SIZE="100M"
RETENTION_DAYS=30

setup_log_rotation() {
#    # åˆ›å»ºlogrotateé…ç½®
    cat > /etc/logrotate.d/ci-builds << EOF
$LOG_DIR/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    maxsize $MAX_LOG_SIZE
    postrotate
        systemctl reload rsyslog
    endscript
}
EOF
    
    echo "âœ… æ—¥å¿—è½®è½¬é…ç½®å·²åˆ›å»º"
}

archive_old_logs() {
    echo "ğŸ—„ï¸ å½’æ¡£æ—§æ—¥å¿—æ–‡ä»¶..."
    
#    # å‹ç¼©30å¤©å‰çš„æ—¥å¿—
    find "$LOG_DIR" -name "*.log" -mtime +$RETENTION_DAYS \
        -exec gzip {} \;
    
#    # åˆ é™¤90å¤©å‰çš„å‹ç¼©æ—¥å¿—
    find "$LOG_DIR" -name "*.log.gz" -mtime +90 \
        -delete
    
    echo "âœ… æ—¥å¿—å½’æ¡£å®Œæˆ"
}

cleanup_build_artifacts() {
#    # æ¸…ç†æ„å»ºäº§ç‰©ï¼ˆä¿ç•™æœ€è¿‘50æ¬¡æ„å»ºï¼‰
    local builds_to_keep=50
    local job_dirs="/var/jenkins_home/jobs/*/builds"
    
    for job_dir in $job_dirs; do
        if [[ -d "$job_dir" ]]; then
            ls -1t "$job_dir" | tail -n +$((builds_to_keep + 1)) | \
            while read -r build_num; do
                rm -rf "$job_dir/$build_num"
                echo "ğŸ—‘ï¸ æ¸…ç†æ—§æ„å»º: $build_num"
            done
        fi
    done
}
```

---

## 5. ğŸš¨ å‘Šè­¦é€šçŸ¥é…ç½®



### 5.1 å‘Šè­¦è§„åˆ™è®¾è®¡



**âš ï¸ å‘Šè­¦è§¦å‘æ¡ä»¶**

è®¾è®¡åˆç†çš„å‘Šè­¦è§„åˆ™ï¼Œé¿å…å‘Šè­¦ç–²åŠ³ï¼š

| å‘Šè­¦çº§åˆ« | **è§¦å‘æ¡ä»¶** | **é€šçŸ¥æ–¹å¼** | **å“åº”æ—¶é—´** |
|---------|-------------|-------------|-------------|
| **ç´§æ€¥** | ç”Ÿäº§ç¯å¢ƒæ„å»ºå¤±è´¥ | ç”µè¯ + çŸ­ä¿¡ + é‚®ä»¶ | 5åˆ†é’Ÿå†… |
| **é‡è¦** | æµ‹è¯•ç¯å¢ƒå¤±è´¥/æ€§èƒ½ä¸‹é™50% | å³æ—¶æ¶ˆæ¯ + é‚®ä»¶ | 15åˆ†é’Ÿå†… |
| **ä¸€èˆ¬** | ä»£ç è´¨é‡ä¸‹é™/æµ‹è¯•è¦†ç›–ç‡ä½ | é‚®ä»¶ | 1å°æ—¶å†… |
| **ä¿¡æ¯** | æ„å»ºæˆåŠŸ/éƒ¨ç½²å®Œæˆ | ä»ªè¡¨æ¿æ˜¾ç¤º | æ— éœ€å“åº” |

### 5.2 å¤šæ¸ é“é€šçŸ¥å®ç°



**ğŸ“± é€šçŸ¥æ¸ é“é…ç½®**

```bash
#!/bin/bash

# å¤šæ¸ é“å‘Šè­¦é€šçŸ¥è„šæœ¬


send_notification() {
    local level="$1"      # CRITICAL/WARNING/INFO
    local title="$2"
    local message="$3"
    local build_url="$4"
    
    case "$level" in
        "CRITICAL")
            send_email_alert "$title" "$message" "$build_url"
            send_slack_alert "$title" "$message" "$build_url"
            send_sms_alert "$title"
            ;;
        "WARNING")
            send_slack_alert "$title" "$message" "$build_url"
            send_email_alert "$title" "$message" "$build_url"
            ;;
        "INFO")
            send_slack_alert "$title" "$message" "$build_url"
            ;;
    esac
}

send_slack_alert() {
    local title="$1"
    local message="$2"
    local build_url="$3"
    
    local payload=$(cat << EOF
{
    "text": "$title",
    "attachments": [
        {
            "color": "danger",
            "fields": [
                {
                    "title": "è¯¦ç»†ä¿¡æ¯",
                    "value": "$message"
                },
                {
                    "title": "æ„å»ºé“¾æ¥",
                    "value": "$build_url"
                }
            ]
        }
    ]
}
EOF
)
    
    curl -X POST -H 'Content-type: application/json' \
         --data "$payload" \
         "$SLACK_WEBHOOK_URL"
}

send_email_alert() {
    local title="$1"
    local message="$2"
    local build_url="$3"
    
#    # ä½¿ç”¨é‚®ä»¶æ¨¡æ¿
    local email_body="
æ„å»ºå‘Šè­¦é€šçŸ¥

é¡¹ç›®: $JOB_NAME
æ„å»º: #$BUILD_NUMBER
çŠ¶æ€: å¤±è´¥
æ—¶é—´: $(date)

å¤±è´¥è¯¦æƒ…:
$message

æŸ¥çœ‹æ„å»ºæ—¥å¿—: $build_url

è¯·åŠæ—¶å¤„ç†è¯¥é—®é¢˜ã€‚
"
    
    echo "$email_body" | mail -s "$title" "$ALERT_EMAIL_LIST"
}
```

### 5.3 å‘Šè­¦æŠ‘åˆ¶å’Œå‡çº§



**ğŸ”‡ æ™ºèƒ½å‘Šè­¦ç®¡ç†**

```bash
# å‘Šè­¦æŠ‘åˆ¶é€»è¾‘ï¼ˆé¿å…é‡å¤å‘Šè­¦ï¼‰

check_alert_suppression() {
    local alert_key="$JOB_NAME-$BUILD_NUMBER"
    local suppress_file="/tmp/alert_suppress.txt"
    local suppress_duration=3600  # 1å°æ—¶å†…ä¸é‡å¤å‘Šè­¦
    
#    # æ£€æŸ¥æ˜¯å¦åœ¨æŠ‘åˆ¶æœŸå†…
    if grep -q "$alert_key" "$suppress_file" 2>/dev/null; then
        local last_alert=$(grep "$alert_key" "$suppress_file" | cut -d':' -f2)
        local current_time=$(date +%s)
        
        if [[ $((current_time - last_alert)) -lt $suppress_duration ]]; then
            echo "â¸ï¸ å‘Šè­¦åœ¨æŠ‘åˆ¶æœŸå†…ï¼Œè·³è¿‡å‘é€"
            return 1
        fi
    fi
    
#    # è®°å½•å‘Šè­¦æ—¶é—´
    echo "$alert_key:$(date +%s)" >> "$suppress_file"
    return 0
}

# å‘Šè­¦å‡çº§æœºåˆ¶ï¼ˆè¿ç»­å¤±è´¥æ—¶å‡çº§å‘Šè­¦çº§åˆ«ï¼‰

check_alert_escalation() {
    local failure_count_file="/tmp/failure_count_${JOB_NAME}.txt"
    local failure_count=1
    
    if [[ -f "$failure_count_file" ]]; then
        failure_count=$(cat "$failure_count_file")
        ((failure_count++))
    fi
    
    echo "$failure_count" > "$failure_count_file"
    
#    # æ ¹æ®è¿ç»­å¤±è´¥æ¬¡æ•°å‡çº§å‘Šè­¦
    if [[ $failure_count -ge 5 ]]; then
        echo "CRITICAL"
    elif [[ $failure_count -ge 3 ]]; then
        echo "WARNING"
    else
        echo "INFO"
    fi
}
```

---

## 6. ğŸ“ˆ æ„å»ºå†å²åˆ†æ



### 6.1 å†å²æ•°æ®æ”¶é›†



**ğŸ“Š æ„å»ºæ•°æ®æŒä¹…åŒ–**

```bash
#!/bin/bash

# æ„å»ºå†å²æ•°æ®æ”¶é›†è„šæœ¬


HISTORY_DB="/var/lib/ci-metrics/build_history.db"

initialize_database() {
    sqlite3 "$HISTORY_DB" << EOF
CREATE TABLE IF NOT EXISTS build_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    job_name TEXT NOT NULL,
    build_number INTEGER NOT NULL,
    result TEXT NOT NULL,
    duration INTEGER NOT NULL,
    timestamp INTEGER NOT NULL,
    branch TEXT,
    commit_hash TEXT,
    triggered_by TEXT
);
EOF
}

record_build_data() {
    local job_name="$1"
    local build_number="$2" 
    local result="$3"
    local duration="$4"
    local branch="$5"
    local commit="$6"
    local trigger="$7"
    
    sqlite3 "$HISTORY_DB" << EOF
INSERT INTO build_history 
(job_name, build_number, result, duration, timestamp, branch, commit_hash, triggered_by)
VALUES 
('$job_name', $build_number, '$result', $duration, $(date +%s), '$branch', '$commit', '$trigger');
EOF
    
    echo "ğŸ“Š æ„å»ºæ•°æ®å·²è®°å½•åˆ°å†å²æ•°æ®åº“"
}
```

### 6.2 è¶‹åŠ¿åˆ†æå®ç°



**ğŸ“ˆ æ„å»ºè¶‹åŠ¿åˆ†æ**

```bash
# ç”Ÿæˆæ„å»ºè¶‹åŠ¿æŠ¥å‘Š

analyze_build_trends() {
    local days_back="${1:-30}"
    local job_name="$2"
    
    echo "ğŸ“ˆ ç”Ÿæˆæœ€è¿‘${days_back}å¤©çš„æ„å»ºè¶‹åŠ¿åˆ†æ..."
    
#    # æˆåŠŸç‡è¶‹åŠ¿
    local success_rate=$(sqlite3 "$HISTORY_DB" << EOF
SELECT 
    ROUND(
        (COUNT(CASE WHEN result = 'SUCCESS' THEN 1 END) * 100.0) / COUNT(*), 
        2
    ) as success_rate
FROM build_history 
WHERE timestamp > $(date -d "$days_back days ago" +%s)
AND job_name = '$job_name';
EOF
)
    
#    # å¹³å‡æ„å»ºæ—¶é•¿
    local avg_duration=$(sqlite3 "$HISTORY_DB" << EOF
SELECT ROUND(AVG(duration) / 60, 2) as avg_minutes
FROM build_history 
WHERE timestamp > $(date -d "$days_back days ago" +%s)
AND job_name = '$job_name'
AND result = 'SUCCESS';
EOF
)
    
#    # æ„å»ºé¢‘ç‡
    local build_frequency=$(sqlite3 "$HISTORY_DB" << EOF
SELECT COUNT(*) / $days_back as daily_builds
FROM build_history 
WHERE timestamp > $(date -d "$days_back days ago" +%s)
AND job_name = '$job_name';
EOF
)
    
    echo "ğŸ“Š æ„å»ºè¶‹åŠ¿åˆ†æç»“æœ:"
    echo "   æˆåŠŸç‡: ${success_rate}%"
    echo "   å¹³å‡è€—æ—¶: ${avg_duration}åˆ†é’Ÿ"
    echo "   æ—¥å‡æ„å»º: ${build_frequency}æ¬¡"
}

# æ€§èƒ½å›å½’æ£€æµ‹

detect_performance_regression() {
    local job_name="$1"
    local threshold_percent=20  # æ€§èƒ½ä¸‹é™è¶…è¿‡20%è§†ä¸ºå›å½’
    
#    # è·å–æœ€è¿‘10æ¬¡æˆåŠŸæ„å»ºçš„å¹³å‡æ—¶é•¿
    local recent_avg=$(sqlite3 "$HISTORY_DB" << EOF
SELECT AVG(duration)
FROM (
    SELECT duration 
    FROM build_history 
    WHERE job_name = '$job_name' AND result = 'SUCCESS'
    ORDER BY timestamp DESC 
    LIMIT 10
);
EOF
)
    
#    # è·å–ä¹‹å‰30æ¬¡æˆåŠŸæ„å»ºçš„å¹³å‡æ—¶é•¿
    local baseline_avg=$(sqlite3 "$HISTORY_DB" << EOF
SELECT AVG(duration)
FROM (
    SELECT duration 
    FROM build_history 
    WHERE job_name = '$job_name' AND result = 'SUCCESS'
    ORDER BY timestamp DESC 
    LIMIT 30 OFFSET 10
);
EOF
)
    
#    # è®¡ç®—æ€§èƒ½å˜åŒ–ç™¾åˆ†æ¯”
    local change_percent=$(echo "scale=2; ($recent_avg - $baseline_avg) * 100 / $baseline_avg" | bc)
    
    if (( $(echo "$change_percent > $threshold_percent" | bc -l) )); then
        echo "âš ï¸ æ£€æµ‹åˆ°æ€§èƒ½å›å½’: æ„å»ºæ—¶é•¿å¢åŠ äº† ${change_percent}%"
        return 1
    else
        echo "âœ… æ€§èƒ½æ­£å¸¸: å˜åŒ–å¹…åº¦ ${change_percent}%"
        return 0
    fi
}
```

---

## 7. ğŸ“‰ å¤±è´¥åŸå› ç»Ÿè®¡



### 7.1 å¤±è´¥åˆ†ç±»ä½“ç³»



**ğŸ·ï¸ å¤±è´¥åŸå› åˆ†ç±»**

å»ºç«‹ç³»ç»ŸåŒ–çš„å¤±è´¥åŸå› åˆ†ç±»ï¼Œä¾¿äºç»Ÿè®¡åˆ†æï¼š

```
å¤±è´¥åŸå› åˆ†ç±»æ ‘:
â”œâ”€â”€ ä»£ç é—®é¢˜ (40%)
â”‚   â”œâ”€â”€ ç¼–è¯‘é”™è¯¯
â”‚   â”œâ”€â”€ è¯­æ³•é”™è¯¯  
â”‚   â””â”€â”€ ä¾èµ–å†²çª
â”œâ”€â”€ æµ‹è¯•é—®é¢˜ (30%)
â”‚   â”œâ”€â”€ å•å…ƒæµ‹è¯•å¤±è´¥
â”‚   â”œâ”€â”€ é›†æˆæµ‹è¯•å¤±è´¥
â”‚   â””â”€â”€ æµ‹è¯•ç¯å¢ƒé—®é¢˜
â”œâ”€â”€ ç¯å¢ƒé—®é¢˜ (20%)
â”‚   â”œâ”€â”€ ç½‘ç»œè¶…æ—¶
â”‚   â”œâ”€â”€ ç£ç›˜ç©ºé—´ä¸è¶³
â”‚   â””â”€â”€ ä¾èµ–æœåŠ¡ä¸å¯ç”¨
â””â”€â”€ é…ç½®é—®é¢˜ (10%)
    â”œâ”€â”€ æµæ°´çº¿é…ç½®é”™è¯¯
    â”œâ”€â”€ æƒé™é—®é¢˜
    â””â”€â”€ å‚æ•°é…ç½®é”™è¯¯
```

### 7.2 æ™ºèƒ½å¤±è´¥åˆ†æ



**ğŸ” è‡ªåŠ¨å¤±è´¥åŸå› è¯†åˆ«**

```bash
#!/bin/bash

# æ™ºèƒ½å¤±è´¥åŸå› åˆ†æè„šæœ¬


analyze_build_failure() {
    local build_log="$1"
    local failure_keywords_file="/etc/ci-monitoring/failure_keywords.conf"
    
    echo "ğŸ” åˆ†ææ„å»ºå¤±è´¥åŸå› ..."
    
#    # é¢„å®šä¹‰çš„å¤±è´¥æ¨¡å¼
    declare -A failure_patterns=(
        ["COMPILE_ERROR"]="error:|é”™è¯¯:|compilation terminated|undefined reference"
        ["TEST_FAILURE"]="test.*failed|assertion.*failed|FAILED.*tests"
        ["NETWORK_ERROR"]="connection.*timeout|network.*unreachable|dns.*resolution"
        ["DISK_SPACE"]="no space left|disk.*full|cannot write"
        ["PERMISSION_ERROR"]="permission denied|access denied|not authorized"
        ["DEPENDENCY_ERROR"]="package.*not found|module.*not found|cannot import"
    )
    
    local detected_issues=()
    
#    # æ‰«ææ—¥å¿—åŒ¹é…å¤±è´¥æ¨¡å¼
    for category in "${!failure_patterns[@]}"; do
        if grep -iE "${failure_patterns[$category]}" "$build_log" >/dev/null; then
            detected_issues+=("$category")
        fi
    done
    
#    # è¾“å‡ºåˆ†æç»“æœ
    if [[ ${#detected_issues[@]} -gt 0 ]]; then
        echo "ğŸ¯ æ£€æµ‹åˆ°å¯èƒ½çš„å¤±è´¥åŸå› :"
        for issue in "${detected_issues[@]}"; do
            echo "   â€¢ $issue"
            suggest_solution "$issue"
        done
    else
        echo "â“ æœªèƒ½è‡ªåŠ¨è¯†åˆ«å¤±è´¥åŸå› ï¼Œéœ€è¦äººå·¥åˆ†æ"
    fi
    
#    # è®°å½•åˆ°ç»Ÿè®¡æ•°æ®åº“
    record_failure_statistics "${detected_issues[@]}"
}

suggest_solution() {
    local issue_type="$1"
    
    case "$issue_type" in
        "COMPILE_ERROR")
            echo "     ğŸ’¡ å»ºè®®: æ£€æŸ¥ä»£ç è¯­æ³•ï¼Œç¡®ä¿ä¾èµ–åº“å®Œæ•´"
            ;;
        "TEST_FAILURE")
            echo "     ğŸ’¡ å»ºè®®: è¿è¡Œæœ¬åœ°æµ‹è¯•ï¼Œä¿®å¤å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹"
            ;;
        "NETWORK_ERROR")
            echo "     ğŸ’¡ å»ºè®®: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œè€ƒè™‘å¢åŠ é‡è¯•æœºåˆ¶"
            ;;
        "DISK_SPACE")
            echo "     ğŸ’¡ å»ºè®®: æ¸…ç†ç£ç›˜ç©ºé—´ï¼Œæ£€æŸ¥æ—¥å¿—è½®è½¬é…ç½®"
            ;;
        "PERMISSION_ERROR")
            echo "     ğŸ’¡ å»ºè®®: æ£€æŸ¥æ–‡ä»¶æƒé™ï¼Œç¡®è®¤ç”¨æˆ·è®¿é—®æƒé™"
            ;;
        "DEPENDENCY_ERROR")
            echo "     ğŸ’¡ å»ºè®®: æ›´æ–°ä¾èµ–åŒ…ï¼Œæ£€æŸ¥package.jsonæˆ–requirements.txt"
            ;;
    esac
}
```

### 7.3 å¤±è´¥ç»Ÿè®¡æŠ¥è¡¨



**ğŸ“Š å¤±è´¥åŸå› ç»Ÿè®¡åˆ†æ**

```bash
generate_failure_statistics() {
    local period_days="${1:-30}"
    
    echo "ğŸ“Š ç”Ÿæˆæœ€è¿‘${period_days}å¤©çš„å¤±è´¥ç»Ÿè®¡æŠ¥å‘Š..."
    
#    # æŸ¥è¯¢å¤±è´¥åŸå› åˆ†å¸ƒ
    sqlite3 "$HISTORY_DB" << EOF > failure_report.txt
.headers on
.mode column

SELECT 
    failure_category as 'å¤±è´¥ç±»å‹',
    COUNT(*) as 'å‘ç”Ÿæ¬¡æ•°',
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) as 'å æ¯”(%)'
FROM build_failures 
WHERE timestamp > $(date -d "$period_days days ago" +%s)
GROUP BY failure_category
ORDER BY COUNT(*) DESC;

SELECT '';
SELECT 'æ€»å¤±è´¥æ¬¡æ•°: ' || COUNT(*) FROM build_failures 
WHERE timestamp > $(date -d "$period_days days ago" +%s);
EOF
    
    echo "ğŸ“‹ å¤±è´¥ç»Ÿè®¡æŠ¥å‘Šå·²ç”Ÿæˆ: failure_report.txt"
    
#    # è¯†åˆ«é«˜é¢‘å¤±è´¥é¡¹ç›®
    identify_problem_projects "$period_days"
}

identify_problem_projects() {
    local days="$1"
    local failure_threshold=5
    
    echo "ğŸ” è¯†åˆ«é—®é¢˜é¢‘å‘çš„é¡¹ç›®..."
    
    sqlite3 "$HISTORY_DB" << EOF
SELECT 
    job_name as 'é¡¹ç›®åç§°',
    COUNT(*) as 'å¤±è´¥æ¬¡æ•°',
    MAX(timestamp) as 'æœ€è¿‘å¤±è´¥æ—¶é—´'
FROM build_history 
WHERE result != 'SUCCESS' 
AND timestamp > $(date -d "$days days ago" +%s)
GROUP BY job_name
HAVING COUNT(*) >= $failure_threshold
ORDER BY COUNT(*) DESC;
EOF
}
```

---

## 8. ğŸ“º æµæ°´çº¿å¯è§†åŒ–å±•ç¤º



### 8.1 å®æ—¶ä»ªè¡¨æ¿è®¾è®¡



**ğŸ“Š ä»ªè¡¨æ¿å…³é”®æŒ‡æ ‡**

ä¸€ä¸ªæœ‰æ•ˆçš„CI/CDä»ªè¡¨æ¿åº”è¯¥åŒ…å«ä»¥ä¸‹æ ¸å¿ƒä¿¡æ¯ï¼š

```
ä»ªè¡¨æ¿å¸ƒå±€è®¾è®¡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å½“å‰çŠ¶æ€åŒº     â”‚    æ€§èƒ½æŒ‡æ ‡åŒº    â”‚    å‘Šè­¦ä¿¡æ¯åŒº    â”‚
â”‚ â€¢ è¿è¡Œä¸­çš„æ„å»º   â”‚ â€¢ å¹³å‡æ„å»ºæ—¶é•¿   â”‚ â€¢ æœ€æ–°å‘Šè­¦      â”‚
â”‚ â€¢ é˜Ÿåˆ—ç­‰å¾…æ•°é‡   â”‚ â€¢ æˆåŠŸç‡è¶‹åŠ¿    â”‚ â€¢ å¾…å¤„ç†é—®é¢˜    â”‚
â”‚ â€¢ åœ¨çº¿Agentæ•°   â”‚ â€¢ ååé‡ç»Ÿè®¡    â”‚ â€¢ ç³»ç»Ÿå¥åº·åº¦    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                æ„å»ºå†å²å’Œè¶‹åŠ¿å›¾è¡¨                    â”‚
â”‚ â€¢ æ¯æ—¥æ„å»ºæ¬¡æ•°   â€¢ å¤±è´¥ç‡å˜åŒ–   â€¢ æ€§èƒ½è¶‹åŠ¿         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                é¡¹ç›®çŠ¶æ€ä¸€è§ˆè¡¨                       â”‚
â”‚ â€¢ å„é¡¹ç›®æœ€æ–°çŠ¶æ€ â€¢ ä¸Šæ¬¡æˆåŠŸæ—¶é—´ â€¢ è´£ä»»äººä¿¡æ¯       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 å¯è§†åŒ–æ•°æ®API



**ğŸ”— ä»ªè¡¨æ¿æ•°æ®æ¥å£**

```bash
#!/bin/bash

# ä¸ºä»ªè¡¨æ¿æä¾›JSONæ ¼å¼çš„ç›‘æ§æ•°æ®


generate_dashboard_data() {
    local output_file="/var/www/html/ci-dashboard/data.json"
    
    echo "ğŸ“Š ç”Ÿæˆä»ªè¡¨æ¿æ•°æ®..."
    
#    # è·å–å½“å‰è¿è¡ŒçŠ¶æ€
    local running_builds=$(get_running_builds_count)
    local queue_size=$(get_queue_size)
    local online_agents=$(get_online_agents_count)
    
#    # è·å–æ€§èƒ½æŒ‡æ ‡
    local avg_build_time=$(get_average_build_time 7)
    local success_rate=$(get_success_rate 7)
    local daily_throughput=$(get_daily_throughput)
    
#    # è·å–æœ€æ–°å‘Šè­¦
    local latest_alerts=$(get_latest_alerts 5)
    
#    # ç”ŸæˆJSONæ•°æ®
    cat > "$output_file" << EOF
{
    "timestamp": "$(date -Iseconds)",
    "current_status": {
        "running_builds": $running_builds,
        "queue_size": $queue_size,
        "online_agents": $online_agents
    },
    "performance_metrics": {
        "avg_build_time_minutes": $avg_build_time,
        "success_rate_percent": $success_rate,
        "daily_throughput": $daily_throughput
    },
    "alerts": $latest_alerts,
    "build_trends": $(generate_trend_data),
    "project_status": $(generate_project_status)
}
EOF
    
    echo "âœ… ä»ªè¡¨æ¿æ•°æ®å·²æ›´æ–°: $output_file"
}

get_running_builds_count() {
#    # æŸ¥è¯¢Jenkins APIè·å–è¿è¡Œä¸­çš„æ„å»ºæ•°é‡
    curl -s "$JENKINS_URL/api/json?tree=executors[currentExecutable[*]]" | \
    jq '[.executors[].currentExecutable] | map(select(. != null)) | length'
}

get_success_rate() {
    local days="$1"
    sqlite3 "$HISTORY_DB" << EOF
SELECT ROUND(
    (COUNT(CASE WHEN result = 'SUCCESS' THEN 1 END) * 100.0) / COUNT(*), 
    2
)
FROM build_history 
WHERE timestamp > $(date -d "$days days ago" +%s);
EOF
}
```

### 8.3 å‘Šè­¦å¯è§†åŒ–



**ğŸš¨ å‘Šè­¦çŠ¶æ€å±•ç¤º**

```bash
# ç”Ÿæˆå‘Šè­¦çŠ¶æ€çš„å¯è§†åŒ–æ•°æ®

generate_alert_visualization() {
    local alert_levels=("CRITICAL" "WARNING" "INFO")
    local alert_data="["
    
    for level in "${alert_levels[@]}"; do
        local count=$(sqlite3 "$ALERT_DB" << EOF
SELECT COUNT(*) FROM alerts 
WHERE level = '$level' 
AND status = 'ACTIVE'
AND timestamp > $(date -d "24 hours ago" +%s);
EOF
)
        alert_data+="{\"level\":\"$level\",\"count\":$count},"
    done
    
#    # ç§»é™¤æœ€åçš„é€—å·å¹¶é—­åˆæ•°ç»„
    alert_data="${alert_data%,}]"
    echo "$alert_data"
}

# ç”Ÿæˆé¡¹ç›®å¥åº·åº¦çƒ­åŠ›å›¾æ•°æ®

generate_project_heatmap() {
    echo "ç”Ÿæˆé¡¹ç›®å¥åº·åº¦çƒ­åŠ›å›¾..."
    
    sqlite3 "$HISTORY_DB" << EOF
SELECT 
    job_name,
    CASE 
        WHEN success_rate >= 95 THEN 'excellent'
        WHEN success_rate >= 85 THEN 'good' 
        WHEN success_rate >= 70 THEN 'warning'
        ELSE 'critical'
    END as health_status,
    success_rate
FROM (
    SELECT 
        job_name,
        ROUND(
            (COUNT(CASE WHEN result = 'SUCCESS' THEN 1 END) * 100.0) / COUNT(*), 
            2
        ) as success_rate
    FROM build_history 
    WHERE timestamp > $(date -d "30 days ago" +%s)
    GROUP BY job_name
    HAVING COUNT(*) >= 5
) ORDER BY success_rate DESC;
EOF
}
```

---

## 9. ğŸ“‹ è¿ç»´æ•°æ®æŠ¥è¡¨



### 9.1 å®šæœŸæŠ¥è¡¨ç”Ÿæˆ



**ğŸ“Š è‡ªåŠ¨åŒ–æŠ¥è¡¨ç³»ç»Ÿ**

```bash
#!/bin/bash

# CI/CDè¿ç»´æ•°æ®æŠ¥è¡¨ç”Ÿæˆè„šæœ¬


REPORT_DIR="/var/reports/ci-cd"
EMAIL_RECIPIENTS="devops-team@company.com"

generate_weekly_report() {
    local report_date=$(date +%Y-%m-%d)
    local report_file="$REPORT_DIR/weekly_report_$report_date.html"
    
    echo "ğŸ“‹ ç”Ÿæˆå‘¨æŠ¥: $report_file"
    
#    # HTMLæŠ¥è¡¨æ¨¡æ¿
    cat > "$report_file" << EOF
<!DOCTYPE html>
<html>
<head>
    <title>CI/CDå‘¨æŠ¥ - $report_date</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .metric { background: #f5f5f5; padding: 10px; margin: 10px 0; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .danger { color: #dc3545; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>CI/CDç³»ç»Ÿå‘¨æŠ¥</h1>
    <p>æŠ¥å‘Šæ—¶é—´: $(date)</p>
    
    <h2>ğŸ“Š å…³é”®æŒ‡æ ‡æ¦‚è§ˆ</h2>
    $(generate_metrics_summary)
    
    <h2>ğŸ“ˆ æ„å»ºè¶‹åŠ¿åˆ†æ</h2>
    $(generate_build_trends_html)
    
    <h2>âš ï¸ é—®é¢˜åˆ†æ</h2>
    $(generate_issues_analysis)
    
    <h2>ğŸ¯ æ”¹è¿›å»ºè®®</h2>
    $(generate_recommendations)
    
</body>
</html>
EOF
    
#    # å‘é€é‚®ä»¶æŠ¥è¡¨
    send_weekly_report "$report_file"
}

generate_metrics_summary() {
    local total_builds=$(get_weekly_build_count)
    local success_rate=$(get_weekly_success_rate)
    local avg_time=$(get_weekly_avg_build_time)
    local failed_builds=$(get_weekly_failed_builds)
    
    cat << EOF
<div class="metric">
    <h3>æœ¬å‘¨æ„å»ºç»Ÿè®¡</h3>
    <ul>
        <li>æ€»æ„å»ºæ¬¡æ•°: <strong>$total_builds</strong></li>
        <li>æˆåŠŸç‡: <strong class="success">$success_rate%</strong></li>
        <li>å¹³å‡æ„å»ºæ—¶é•¿: <strong>$avg_time åˆ†é’Ÿ</strong></li>
        <li>å¤±è´¥æ„å»ºæ•°: <strong class="danger">$failed_builds</strong></li>
    </ul>
</div>
EOF
}

generate_build_trends_html() {
    echo "<table>"
    echo "<tr><th>æ—¥æœŸ</th><th>æ„å»ºæ¬¡æ•°</th><th>æˆåŠŸæ¬¡æ•°</th><th>å¤±è´¥æ¬¡æ•°</th><th>æˆåŠŸç‡</th></tr>"
    
    for i in {6..0}; do
        local date=$(date -d "$i days ago" +%Y-%m-%d)
        local total=$(get_daily_build_count "$date")
        local success=$(get_daily_success_count "$date")
        local failed=$((total - success))
        local rate=$(echo "scale=1; $success * 100 / $total" | bc -l 2>/dev/null || echo "0")
        
        echo "<tr>"
        echo "<td>$date</td>"
        echo "<td>$total</td>"
        echo "<td>$success</td>"
        echo "<td>$failed</td>"
        echo "<td>$rate%</td>"
        echo "</tr>"
    done
    
    echo "</table>"
}
```

### 9.2 å®¹é‡è§„åˆ’æŠ¥å‘Š



**ğŸ“ˆ èµ„æºä½¿ç”¨åˆ†æ**

```bash
generate_capacity_report() {
    echo "ğŸ“ˆ ç”Ÿæˆå®¹é‡è§„åˆ’æŠ¥å‘Š..."
    
    local cpu_peak=$(get_peak_cpu_usage 7)
    local memory_peak=$(get_peak_memory_usage 7)
    local disk_growth=$(get_disk_growth_rate 30)
    local agent_utilization=$(get_agent_utilization 7)
    
    cat << EOF
=== CI/CDç³»ç»Ÿå®¹é‡åˆ†ææŠ¥å‘Š ===

ğŸ“Š èµ„æºä½¿ç”¨æƒ…å†µ:
   CPUå³°å€¼ä½¿ç”¨ç‡: $cpu_peak%
   å†…å­˜å³°å€¼ä½¿ç”¨ç‡: $memory_peak%
   ç£ç›˜æœˆå¢é•¿ç‡: $disk_growth%
   Agentå¹³å‡åˆ©ç”¨ç‡: $agent_utilization%

ğŸ“ˆ è¶‹åŠ¿é¢„æµ‹:
$(predict_resource_trends)

ğŸ¯ æ‰©å®¹å»ºè®®:
$(generate_scaling_recommendations)

âš ï¸ é£é™©æé†’:
$(identify_capacity_risks)
EOF
}

predict_resource_trends() {
#    # åŸºäºå†å²æ•°æ®é¢„æµ‹æœªæ¥èµ„æºéœ€æ±‚
    local current_builds_per_day=$(get_current_daily_builds)
    local growth_rate=$(calculate_build_growth_rate 90)
    local predicted_builds=$((current_builds_per_day + current_builds_per_day * growth_rate / 100))
    
    echo "   â€¢ é¢„è®¡æœˆæ„å»ºé‡å¢é•¿: $growth_rate%"
    echo "   â€¢ é¢„è®¡æ—¥å‡æ„å»ºæ•°: $predicted_builds æ¬¡"
    
    if [[ $predicted_builds -gt 100 ]]; then
        echo "   â€¢ å»ºè®®å¢åŠ æ„å»ºAgentèŠ‚ç‚¹"
    fi
}

generate_scaling_recommendations() {
    local current_agents=$(get_active_agents_count)
    local avg_queue_time=$(get_average_queue_time 7)
    
    if [[ $(echo "$avg_queue_time > 300" | bc -l) -eq 1 ]]; then
        echo "   â€¢ é˜Ÿåˆ—ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œå»ºè®®å¢åŠ  $((current_agents / 2)) ä¸ªAgent"
    fi
    
    if [[ $cpu_peak -gt 80 ]]; then
        echo "   â€¢ CPUä½¿ç”¨ç‡è¾ƒé«˜ï¼Œå»ºè®®å‡çº§ä¸»èŠ‚ç‚¹é…ç½®"
    fi
    
    if [[ $memory_peak -gt 85 ]]; then
        echo "   â€¢ å†…å­˜ä½¿ç”¨ç‡è¾ƒé«˜ï¼Œå»ºè®®å¢åŠ å†…å­˜æˆ–ä¼˜åŒ–æ„å»ºæµç¨‹"
    fi
}
```

### 9.3 SLAå’ŒKPIæŠ¥å‘Š



**ğŸ¯ æœåŠ¡æ°´å¹³æŠ¥å‘Š**

```bash
generate_sla_report() {
    local period_days=30
    
    echo "ğŸ¯ ç”ŸæˆSLAè¾¾æˆæƒ…å†µæŠ¥å‘Š..."
    
    cat << EOF
=== CI/CDç³»ç»ŸSLAæŠ¥å‘Š (æœ€è¿‘${period_days}å¤©) ===

ğŸ“Š æ ¸å¿ƒSLAæŒ‡æ ‡:
   âœ“ ç³»ç»Ÿå¯ç”¨æ€§: $(calculate_system_uptime $period_days)% (ç›®æ ‡: >99%)
   âœ“ æ„å»ºæˆåŠŸç‡: $(get_success_rate $period_days)% (ç›®æ ‡: >95%)
   âœ“ å¹³å‡æ„å»ºæ—¶é•¿: $(get_average_build_time $period_days)åˆ†é’Ÿ (ç›®æ ‡: <15åˆ†é’Ÿ)
   âœ“ å¹³å‡ä¿®å¤æ—¶é—´: $(calculate_mttr $period_days)åˆ†é’Ÿ (ç›®æ ‡: <30åˆ†é’Ÿ)

ğŸ“ˆ å…³é”®KPIè¶‹åŠ¿:
   â€¢ éƒ¨ç½²é¢‘ç‡: $(calculate_deployment_frequency $period_days) æ¬¡/å¤©
   â€¢ å˜æ›´å‰ç½®æ—¶é—´: $(calculate_lead_time $period_days) å°æ—¶
   â€¢ å˜æ›´å¤±è´¥ç‡: $(calculate_change_failure_rate $period_days)%

ğŸ¯ SLAè¾¾æˆçŠ¶æ€:
$(check_sla_compliance)

ğŸ“‹ æ”¹è¿›è¡ŒåŠ¨è®¡åˆ’:
$(generate_improvement_plan)
EOF
}

check_sla_compliance() {
    local uptime=$(calculate_system_uptime 30)
    local success_rate=$(get_success_rate 30)
    local avg_time=$(get_average_build_time 30)
    
    local sla_score=0
    
    if [[ $(echo "$uptime >= 99" | bc -l) -eq 1 ]]; then
        echo "   âœ… ç³»ç»Ÿå¯ç”¨æ€§è¾¾æ ‡"
        ((sla_score++))
    else
        echo "   âŒ ç³»ç»Ÿå¯ç”¨æ€§æœªè¾¾æ ‡"
    fi
    
    if [[ $(echo "$success_rate >= 95" | bc -l) -eq 1 ]]; then
        echo "   âœ… æ„å»ºæˆåŠŸç‡è¾¾æ ‡"
        ((sla_score++))
    else
        echo "   âŒ æ„å»ºæˆåŠŸç‡æœªè¾¾æ ‡"
    fi
    
    if [[ $(echo "$avg_time <= 15" | bc -l) -eq 1 ]]; then
        echo "   âœ… æ„å»ºæ—¶é•¿è¾¾æ ‡"
        ((sla_score++))
    else
        echo "   âŒ æ„å»ºæ—¶é•¿æœªè¾¾æ ‡"
    fi
    
    echo "   ğŸ“Š SLAç»¼åˆå¾—åˆ†: $sla_score/3"
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ æµæ°´çº¿ç›‘æ§ï¼šå®æ—¶è·Ÿè¸ªCI/CDæ‰§è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
ğŸ”¸ æ—¥å¿—ç®¡ç†ï¼šç»“æ„åŒ–æ”¶é›†ã€å­˜å‚¨ã€åˆ†ææ„å»ºè¿‡ç¨‹æ—¥å¿—
ğŸ”¸ å‘Šè­¦é€šçŸ¥ï¼šåŠæ—¶å‘ç°é—®é¢˜å¹¶é€šè¿‡å¤šæ¸ é“é€šçŸ¥ç›¸å…³äººå‘˜
ğŸ”¸ å†å²åˆ†æï¼šåŸºäºå†å²æ•°æ®è¯†åˆ«è¶‹åŠ¿å’Œæ€§èƒ½å›å½’
ğŸ”¸ å¯è§†åŒ–å±•ç¤ºï¼šé€šè¿‡ä»ªè¡¨æ¿ç›´è§‚å±•ç¤ºç³»ç»ŸçŠ¶æ€
ğŸ”¸ æ•°æ®æŠ¥è¡¨ï¼šå®šæœŸç”Ÿæˆè¿ç»´æŠ¥å‘Šæ”¯æŒå†³ç­–
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§CI/CDæµæ°´çº¿**
```
é—®é¢˜åŠæ—¶å‘ç°ï¼š
- æ„å»ºå¤±è´¥ç«‹å³æ„ŸçŸ¥ï¼Œé¿å…å½±å“å¼€å‘è¿›åº¦
- æ€§èƒ½ä¸‹é™æ—©æœŸé¢„è­¦ï¼Œé˜²æ­¢ç§¯ç´¯æˆä¸¥é‡é—®é¢˜

æ•°æ®é©±åŠ¨ä¼˜åŒ–ï¼š
- åŸºäºå®¢è§‚æ•°æ®è¯†åˆ«ç“¶é¢ˆç¯èŠ‚
- é€šè¿‡å†å²è¶‹åŠ¿åˆ¶å®šæ”¹è¿›ç­–ç•¥

è¿ç»´æ•ˆç‡æå‡ï¼š
- è‡ªåŠ¨åŒ–å‘Šè­¦å‡å°‘äººå·¥å·¡æ£€
- å¯è§†åŒ–å±•ç¤ºæé«˜é—®é¢˜å®šä½æ•ˆç‡
```

**ğŸ”¹ ç›‘æ§ç³»ç»Ÿè®¾è®¡åŸåˆ™**
```
å…¨é¢æ€§ï¼šè¦†ç›–çŠ¶æ€ã€æ€§èƒ½ã€æ—¥å¿—ã€å‘Šè­¦å„ä¸ªç»´åº¦
å®æ—¶æ€§ï¼šå…³é”®é—®é¢˜èƒ½å¤ŸåŠæ—¶å‘ç°å’Œå“åº”
å¯æ‰©å±•ï¼šæ”¯æŒæ–°é¡¹ç›®å’Œæ–°æŒ‡æ ‡çš„å¿«é€Ÿæ¥å…¥
æ™ºèƒ½åŒ–ï¼šè‡ªåŠ¨åˆ†æå¤±è´¥åŸå› ï¼Œå‡å°‘äººå·¥å¹²é¢„
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ ä¼ä¸šåº”ç”¨åœºæ™¯**
- **å¼€å‘å›¢é˜Ÿ**ï¼šé€šè¿‡ä»ªè¡¨æ¿å®æ—¶äº†è§£æ„å»ºçŠ¶æ€
- **è¿ç»´å›¢é˜Ÿ**ï¼šåŸºäºç›‘æ§æ•°æ®è¿›è¡Œå®¹é‡è§„åˆ’
- **ç®¡ç†å±‚**ï¼šé€šè¿‡SLAæŠ¥å‘Šè¯„ä¼°ç ”å‘æ•ˆèƒ½
- **è´¨é‡å›¢é˜Ÿ**ï¼šåˆ†æå¤±è´¥åŸå› æŒç»­æ”¹è¿›æµç¨‹

**ğŸ› ï¸ æœ€ä½³å®è·µå»ºè®®**
```
ç›‘æ§æŒ‡æ ‡é€‰æ‹©ï¼š
- å…³æ³¨ä¸šåŠ¡ä»·å€¼ç›¸å…³çš„æ ¸å¿ƒæŒ‡æ ‡
- é¿å…ç›‘æ§æŒ‡æ ‡è¿‡å¤šå¯¼è‡´ä¿¡æ¯è¿‡è½½
- å®šæœŸè¯„ä¼°å’Œè°ƒæ•´ç›‘æ§ç­–ç•¥

å‘Šè­¦ç­–ç•¥ï¼š
- è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼é¿å…è¯¯æŠ¥
- å»ºç«‹å‘Šè­¦å‡çº§æœºåˆ¶å¤„ç†ç´§æ€¥é—®é¢˜
- å®šæœŸå›é¡¾å‘Šè­¦æœ‰æ•ˆæ€§

æ•°æ®åˆ†æï¼š
- å»ºç«‹åŸºçº¿è¿›è¡Œè¶‹åŠ¿å¯¹æ¯”
- ç»“åˆä¸šåŠ¡ä¸Šä¸‹æ–‡åˆ†ææ•°æ®å¼‚å¸¸
- å°†åˆ†æç»“æœè½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„æ”¹è¿›è¡ŒåŠ¨
```

### 10.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



- [ ] èƒ½å¤Ÿé…ç½®æ„å»ºçŠ¶æ€ç›‘æ§
- [ ] ä¼šè®¾è®¡åˆç†çš„å‘Šè­¦è§„åˆ™
- [ ] æŒæ¡æ—¥å¿—ç®¡ç†æœ€ä½³å®è·µ
- [ ] èƒ½å¤Ÿè¿›è¡Œæ„å»ºå†å²åˆ†æ
- [ ] ä¼šæ„å»ºç›‘æ§ä»ªè¡¨æ¿
- [ ] èƒ½å¤Ÿç”Ÿæˆè¿ç»´æŠ¥è¡¨

**ğŸ”‘ æ ¸å¿ƒè®°å¿†å£è¯€**
> ç›‘æ§å‘Šè­¦è¦åŠæ—¶ï¼Œæ—¥å¿—åˆ†ææ‰¾é—®é¢˜
> å†å²è¶‹åŠ¿åŠ©å†³ç­–ï¼Œå¯è§†å±•ç¤ºææ•ˆç‡
> æ•°æ®æŠ¥è¡¨çœ‹å…¨å±€ï¼ŒæŒç»­æ”¹è¿›æ˜¯ç‹é“

**ğŸ’¡ å»¶ä¼¸å­¦ä¹ å»ºè®®**
- å­¦ä¹ Prometheus+Grafanaç›‘æ§æŠ€æœ¯æ ˆ
- äº†è§£ELK(Elasticsearch+Logstash+Kibana)æ—¥å¿—åˆ†æ
- ç ”ç©¶DevOpsåº¦é‡ä½“ç³»å’ŒDORAæŒ‡æ ‡
- æŒæ¡è‡ªåŠ¨åŒ–è¿ç»´å’Œæ™ºèƒ½åŒ–ç›‘æ§æŠ€æœ¯