---
title: 8ã€æ ¸å¿ƒç³»ç»Ÿè°ƒç”¨è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿè°ƒç”¨åŸºç¡€æ¦‚å¿µ](#1-ç³»ç»Ÿè°ƒç”¨åŸºç¡€æ¦‚å¿µ)
2. [æ–‡ä»¶æ“ä½œç³»ç»Ÿè°ƒç”¨](#2-æ–‡ä»¶æ“ä½œç³»ç»Ÿè°ƒç”¨)
3. [è¿›ç¨‹æ§åˆ¶ç³»ç»Ÿè°ƒç”¨](#3-è¿›ç¨‹æ§åˆ¶ç³»ç»Ÿè°ƒç”¨)
4. [å†…å­˜ç®¡ç†ç³»ç»Ÿè°ƒç”¨](#4-å†…å­˜ç®¡ç†ç³»ç»Ÿè°ƒç”¨)
5. [ä¿¡å·å¤„ç†ç³»ç»Ÿè°ƒç”¨](#5-ä¿¡å·å¤„ç†ç³»ç»Ÿè°ƒç”¨)
6. [æ—¶é—´ç›¸å…³ç³»ç»Ÿè°ƒç”¨](#6-æ—¶é—´ç›¸å…³ç³»ç»Ÿè°ƒç”¨)
7. [æ–‡ä»¶ç³»ç»Ÿæ“ä½œè°ƒç”¨](#7-æ–‡ä»¶ç³»ç»Ÿæ“ä½œè°ƒç”¨)
8. [ç½‘ç»œç›¸å…³ç³»ç»Ÿè°ƒç”¨](#8-ç½‘ç»œç›¸å…³ç³»ç»Ÿè°ƒç”¨)
9. [è¿›ç¨‹é—´é€šä¿¡è°ƒç”¨](#9-è¿›ç¨‹é—´é€šä¿¡è°ƒç”¨)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ ç³»ç»Ÿè°ƒç”¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿè°ƒç”¨


**ç³»ç»Ÿè°ƒç”¨**å°±åƒæ˜¯åº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´çš„"ä¸“ç”¨ç”µè¯"ã€‚å½“ä½ çš„ç¨‹åºéœ€è¦åšä¸€äº›åªæœ‰æ“ä½œç³»ç»Ÿæ‰èƒ½åšçš„äº‹æƒ…æ—¶ï¼ˆæ¯”å¦‚è¯»å†™æ–‡ä»¶ã€åˆ›å»ºè¿›ç¨‹ï¼‰ï¼Œå°±å¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥è¯·æ±‚å†…æ ¸å¸®å¿™ã€‚

```
åº”ç”¨ç¨‹åºå±‚          ä½ å†™çš„Cç¨‹åºã€Shellè„šæœ¬ç­‰
     |
    ç³»ç»Ÿè°ƒç”¨         ç¨‹åºå‘å†…æ ¸è¯·æ±‚æœåŠ¡çš„æ¥å£
     |
   å†…æ ¸å±‚            Linuxå†…æ ¸ï¼Œç®¡ç†ç¡¬ä»¶èµ„æº
     |
   ç¡¬ä»¶å±‚            CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘å¡ç­‰
```

### 1.2 ç³»ç»Ÿè°ƒç”¨çš„å·¥ä½œæœºåˆ¶


**å·¥ä½œæµç¨‹å›¾ç¤º**ï¼š
```
ç”¨æˆ·ç¨‹åº                           å†…æ ¸
   |                               |
   |--[1]è°ƒç”¨ç³»ç»Ÿè°ƒç”¨å‡½æ•°----------->|
   |   ä¾‹å¦‚: open("file.txt")       |
   |                               |--[2]åˆ‡æ¢åˆ°å†…æ ¸æ€
   |                               |--[3]æ‰§è¡Œå†…æ ¸ä»£ç 
   |                               |--[4]è®¿é—®ç¡¬ä»¶èµ„æº
   |                               |--[5]å‡†å¤‡è¿”å›ç»“æœ
   |<--[6]è¿”å›ç»“æœåˆ°ç”¨æˆ·ç¨‹åº--------|
   |   è¿”å›æ–‡ä»¶æè¿°ç¬¦æˆ–é”™è¯¯ç         |
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **æƒé™åˆ‡æ¢**ï¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œè·å¾—è®¿é—®ç¡¬ä»¶çš„æƒé™
- **å‚æ•°ä¼ é€’**ï¼šé€šè¿‡å¯„å­˜å™¨æˆ–æ ˆä¼ é€’å‚æ•°ç»™å†…æ ¸
- **è¿”å›å€¼**ï¼šæˆåŠŸæ—¶è¿”å›æœ‰ç”¨çš„å€¼ï¼Œå¤±è´¥æ—¶è¿”å›-1å¹¶è®¾ç½®errno

### 1.3 ç³»ç»Ÿè°ƒç”¨ vs åº“å‡½æ•°


**å¯¹æ¯”ç†è§£**ï¼š

| ç‰¹æ€§ | **ç³»ç»Ÿè°ƒç”¨** | **åº“å‡½æ•°** |
|------|-------------|-----------|
| ğŸ¯ **æœ¬è´¨** | `ç›´æ¥è¯·æ±‚å†…æ ¸æœåŠ¡` | `å°è£…ç³»ç»Ÿè°ƒç”¨çš„ä¾¿æ°‘å‡½æ•°` |
| âš¡ **æ€§èƒ½** | `å¼€é”€å¤§ï¼Œéœ€è¦æ¨¡å¼åˆ‡æ¢` | `å¼€é”€å°ï¼Œå¯èƒ½æœ‰ç¼“å­˜ä¼˜åŒ–` |
| ğŸ”’ **æƒé™** | `å¿…é¡»åˆ‡æ¢åˆ°å†…æ ¸æ€` | `åœ¨ç”¨æˆ·æ€è¿è¡Œ` |
| ğŸ“ **ç¤ºä¾‹** | `write()ç›´æ¥å†™æ•°æ®` | `printf()æ ¼å¼åŒ–åè°ƒç”¨write()` |

**å®é™…ä¾‹å­**ï¼š
```c
// ç³»ç»Ÿè°ƒç”¨ï¼šç›´æ¥å‘Šè¯‰å†…æ ¸"å†™è¿™äº›å­—èŠ‚åˆ°æ–‡ä»¶"
write(fd, "Hello", 5);

// åº“å‡½æ•°ï¼šå…ˆæ ¼å¼åŒ–ï¼Œå†è°ƒç”¨ç³»ç»Ÿè°ƒç”¨
printf("Hello %s\n", name);  // å†…éƒ¨æœ€ç»ˆè°ƒç”¨write()
```

---

## 2. ğŸ“ æ–‡ä»¶æ“ä½œç³»ç»Ÿè°ƒç”¨


### 2.1 open - æ‰“å¼€æ–‡ä»¶


**ä½œç”¨**ï¼šå‘å†…æ ¸ç”³è¯·æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè·å¾—æ“ä½œè¿™ä¸ªæ–‡ä»¶çš„"é’¥åŒ™"ï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚

```c
#include <fcntl.h>
int open(const char *pathname, int flags, mode_t mode);
```

**å‚æ•°è¯¦è§£**ï¼š

**pathnameï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰**ï¼š
- å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼š`/home/user/data.txt`
- å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼š`./config.ini`
- æ–‡ä»¶ä¸å­˜åœ¨æ—¶çš„è¡Œä¸ºå–å†³äºflagså‚æ•°

**flagsï¼ˆæ‰“å¼€æ–¹å¼ï¼‰**ï¼š
```
ğŸ”¸ åŸºæœ¬æ¨¡å¼ï¼ˆå¿…é€‰å…¶ä¸€ï¼‰ï¼š
O_RDONLY    åªè¯»æ¨¡å¼ï¼Œåƒæ˜¯"åªèƒ½çœ‹ä¹¦ä¸èƒ½å†™å­—"
O_WRONLY    åªå†™æ¨¡å¼ï¼Œåƒæ˜¯"åªèƒ½å†™å­—çœ‹ä¸åˆ°å†…å®¹"  
O_RDWR      è¯»å†™æ¨¡å¼ï¼Œåƒæ˜¯"æ—¢èƒ½çœ‹åˆèƒ½å†™"

ğŸ”¸ åˆ›å»ºæ§åˆ¶ï¼š
O_CREAT     æ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»ºå®ƒ
O_EXCL      ä¸O_CREATä¸€èµ·ç”¨ï¼Œæ–‡ä»¶å­˜åœ¨æ—¶æŠ¥é”™
O_TRUNC     æ‰“å¼€æ—¶æ¸…ç©ºæ–‡ä»¶å†…å®¹

ğŸ”¸ å†™å…¥æ§åˆ¶ï¼š
O_APPEND    æ€»æ˜¯åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ å†™å…¥
```

**modeï¼ˆæƒé™è®¾ç½®ï¼‰**ï¼šåªåœ¨åˆ›å»ºæ–°æ–‡ä»¶æ—¶æœ‰æ•ˆ
```
0644  â†’  rw-r--r--  æ–‡ä»¶æ‰€æœ‰è€…å¯è¯»å†™ï¼Œå…¶ä»–äººåªè¯»
0755  â†’  rwxr-xr-x  æ–‡ä»¶æ‰€æœ‰è€…å¯æ‰§è¡Œï¼Œå…¶ä»–äººå¯è¯»æ‰§è¡Œ
```

**å®ç”¨ç¤ºä¾‹**ï¼š
```c
// åªè¯»æ‰“å¼€å·²å­˜åœ¨æ–‡ä»¶
int fd = open("/etc/passwd", O_RDONLY);

// åˆ›å»ºæ–°æ–‡ä»¶å¹¶å†™å…¥
int fd = open("output.txt", O_CREAT | O_WRONLY | O_TRUNC, 0644);

// è¿½åŠ å†™å…¥æ—¥å¿—æ–‡ä»¶
int fd = open("app.log", O_CREAT | O_WRONLY | O_APPEND, 0644);
```

### 2.2 read - è¯»å–æ•°æ®


**ä½œç”¨**ï¼šä»æ–‡ä»¶æè¿°ç¬¦ä¸­è¯»å–æŒ‡å®šå­—èŠ‚æ•°çš„æ•°æ®åˆ°å†…å­˜ç¼“å†²åŒºã€‚

```c
#include <unistd.h>
ssize_t read(int fd, void *buf, size_t count);
```

**å·¥ä½œåŸç†å›¾ç¤º**ï¼š
```
æ–‡ä»¶å†…å®¹ï¼š  [H][e][l][l][o][ ][W][o][r][l][d]
æ–‡ä»¶æŒ‡é’ˆï¼š   â†‘ 
           è¯»å–ä½ç½®

è°ƒç”¨ read(fd, buffer, 5) åï¼š
bufferï¼š   [H][e][l][l][o]
æ–‡ä»¶æŒ‡é’ˆï¼š            â†‘
                   æ–°ä½ç½®
```

**é‡è¦ç‰¹æ€§**ï¼š
- **è¿”å›å€¼**ï¼šå®é™…è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¯èƒ½å°‘äºè¯·æ±‚çš„å­—èŠ‚æ•°
- **æ–‡ä»¶æŒ‡é’ˆ**ï¼šæ¯æ¬¡è¯»å–åè‡ªåŠ¨å‘å‰ç§»åŠ¨
- **é˜»å¡è¡Œä¸º**ï¼šæ™®é€šæ–‡ä»¶ç«‹å³è¿”å›ï¼Œç®¡é“/ç½‘ç»œå¯èƒ½é˜»å¡ç­‰å¾…æ•°æ®

**å®ç”¨ç¤ºä¾‹**ï¼š
```c
char buffer[1024];
ssize_t bytes_read = read(fd, buffer, sizeof(buffer));

if (bytes_read == -1) {
    perror("è¯»å–å¤±è´¥");
} else if (bytes_read == 0) {
    printf("å·²åˆ°æ–‡ä»¶æœ«å°¾\n");
} else {
    printf("è¯»å–äº† %ld å­—èŠ‚\n", bytes_read);
}
```

### 2.3 write - å†™å…¥æ•°æ®


**ä½œç”¨**ï¼šå°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶æè¿°ç¬¦ä¸­ã€‚

```c
#include <unistd.h>
ssize_t write(int fd, const void *buf, size_t count);
```

**å†™å…¥æ¨¡å¼å¯¹æ¯”**ï¼š
```
æ™®é€šå†™å…¥ï¼š        æ–‡ä»¶å¼€å¤´å†™å…¥ï¼Œè¦†ç›–åŸå†…å®¹
O_APPENDæ¨¡å¼ï¼š    æ€»æ˜¯åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ 
O_TRUNCæ¨¡å¼ï¼š     å…ˆæ¸…ç©ºæ–‡ä»¶å†å†™å…¥
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```c
// å†™å…¥å­—ç¬¦ä¸²åˆ°æ–‡ä»¶
const char *msg = "Hello Linux\n";
write(fd, msg, strlen(msg));

// å†™å…¥äºŒè¿›åˆ¶æ•°æ®
struct data_record record = {123, "test"};
write(fd, &record, sizeof(record));

// é”™è¯¯å¤„ç†
ssize_t written = write(fd, data, size);
if (written != size) {
    fprintf(stderr, "å†™å…¥ä¸å®Œæ•´ï¼šæœŸæœ›%ldï¼Œå®é™…%ld\n", size, written);
}
```

### 2.4 close - å…³é—­æ–‡ä»¶


**ä½œç”¨**ï¼šå‘Šè¯‰å†…æ ¸ä¸å†éœ€è¦è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œé‡Šæ”¾ç›¸å…³èµ„æºã€‚

```c
#include <unistd.h>
int close(int fd);
```

> ğŸ’¡ **é‡è¦æé†’**ï¼šæ¯ä¸ªopen()éƒ½åº”è¯¥æœ‰å¯¹åº”çš„close()ï¼Œå°±åƒå€Ÿä¹¦è¦è¿˜ä¹¦ä¸€æ ·ã€‚å¿˜è®°å…³é—­ä¼šå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œç¨‹åºæœ€ç»ˆæ— æ³•æ‰“å¼€æ–°æ–‡ä»¶ã€‚

**å®Œæ•´æ–‡ä»¶æ“ä½œç¤ºä¾‹**ï¼š
```c
#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>

int main() {
    int fd = open("example.txt", O_CREAT | O_WRONLY | O_TRUNC, 0644);
    if (fd == -1) {
        perror("æ‰“å¼€æ–‡ä»¶å¤±è´¥");
        return 1;
    }
    
    write(fd, "Hello Linux\n", 12);
    close(fd);  // é‡è¦ï¼šé‡Šæ”¾èµ„æº
    
    return 0;
}
```

---

## 3. ğŸš€ è¿›ç¨‹æ§åˆ¶ç³»ç»Ÿè°ƒç”¨


### 3.1 fork - åˆ›å»ºå­è¿›ç¨‹


**ä½œç”¨**ï¼šåˆ›å»ºä¸€ä¸ªå½“å‰è¿›ç¨‹çš„å®Œå…¨å‰¯æœ¬ï¼Œå°±åƒæ˜¯"å¤åˆ¶ç²˜è´´"ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºã€‚

```c
#include <unistd.h>
pid_t fork(void);
```

**forkçš„ç¥å¥‡ä¹‹å¤„**ï¼šä¸€æ¬¡è°ƒç”¨ï¼Œä¸¤æ¬¡è¿”å›ï¼

```
è°ƒç”¨fork()å‰ï¼š
çˆ¶è¿›ç¨‹: [æ­£åœ¨è¿è¡Œçš„ç¨‹åº]

è°ƒç”¨fork()åï¼š
çˆ¶è¿›ç¨‹: [åŸç¨‹åºç»§ç»­] â† fork()è¿”å›å­è¿›ç¨‹PID
    |
    â””â”€â”€â†’ å­è¿›ç¨‹: [ç¨‹åºå‰¯æœ¬] â† fork()è¿”å›0
```

**è¿”å›å€¼çš„å«ä¹‰**ï¼š
- **åœ¨çˆ¶è¿›ç¨‹ä¸­**ï¼šè¿”å›å­è¿›ç¨‹çš„PIDï¼ˆè¿›ç¨‹IDï¼Œä¸€ä¸ªæ­£æ•°ï¼‰
- **åœ¨å­è¿›ç¨‹ä¸­**ï¼šè¿”å›0
- **å‡ºé”™æ—¶**ï¼šè¿”å›-1

**ç»å…¸ç¤ºä¾‹**ï¼š
```c
#include <unistd.h>
#include <stdio.h>

int main() {
    printf("ç¨‹åºå¼€å§‹è¿è¡Œ\n");
    
    pid_t pid = fork();
    
    if (pid == -1) {
        perror("forkå¤±è´¥");
        return 1;
    } else if (pid == 0) {
        // è¿™é‡Œæ˜¯å­è¿›ç¨‹
        printf("æˆ‘æ˜¯å­è¿›ç¨‹ï¼ŒPID=%d\n", getpid());
    } else {
        // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
        printf("æˆ‘æ˜¯çˆ¶è¿›ç¨‹ï¼Œå­è¿›ç¨‹PID=%d\n", pid);
    }
    
    return 0;
}
```

### 3.2 execç³»åˆ— - ç¨‹åºæ›¿æ¢


**ä½œç”¨**ï¼šå°†å½“å‰è¿›ç¨‹çš„ç¨‹åºæ›¿æ¢ä¸ºæ–°ç¨‹åºï¼Œå°±åƒæ˜¯"æ¢èŠ¯"æ“ä½œã€‚

**å¸¸ç”¨çš„execå‡½æ•°**ï¼š
```c
int execl(const char *path, const char *arg, ...);
int execp(const char *file, const char *arg, ...);
int execv(const char *path, char *const argv[]);
```

**å‡½æ•°åè§£è¯»**ï¼š
- **exec**ï¼šæ‰§è¡Œæ–°ç¨‹åºçš„åŸºç¡€åŠŸèƒ½
- **l**ï¼šå‚æ•°ä»¥åˆ—è¡¨(list)å½¢å¼ä¼ é€’
- **v**ï¼šå‚æ•°ä»¥å‘é‡(vector)æ•°ç»„å½¢å¼ä¼ é€’
- **p**ï¼šåœ¨PATHç¯å¢ƒå˜é‡ä¸­æœç´¢ç¨‹åº

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```c
// åœºæ™¯1ï¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤
if (fork() == 0) {
    // å­è¿›ç¨‹æ‰§è¡Œ ls -l å‘½ä»¤
    execl("/bin/ls", "ls", "-l", NULL);
    perror("execå¤±è´¥");  // åªæœ‰execå¤±è´¥æ‰ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
    exit(1);
}

// åœºæ™¯2ï¼šè¿è¡Œç”¨æˆ·ç¨‹åº
if (fork() == 0) {
    char *args[] = {"./myprogram", "arg1", "arg2", NULL};
    execv("./myprogram", args);
    perror("execå¤±è´¥");
    exit(1);
}
```

### 3.3 waitç³»åˆ— - ç­‰å¾…å­è¿›ç¨‹


**ä½œç”¨**ï¼šçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œé¿å…äº§ç”Ÿ"åƒµå°¸è¿›ç¨‹"ã€‚

```c
#include <sys/wait.h>
pid_t wait(int *status);
pid_t waitpid(pid_t pid, int *status, int options);
```

**ä¸ºä»€ä¹ˆéœ€è¦wait**ï¼š
```
å­è¿›ç¨‹ç»“æŸåï¼š
- å˜æˆåƒµå°¸è¿›ç¨‹ï¼Œå ç”¨è¿›ç¨‹è¡¨é¡¹
- çˆ¶è¿›ç¨‹è°ƒç”¨wait()åï¼Œåƒµå°¸è¿›ç¨‹æ‰è¢«å½»åº•æ¸…ç†
- å°±åƒå­©å­ç¦»å®¶è¦å‘Šè¯‰çˆ¶æ¯ä¸€æ ·
```

**statuså‚æ•°è§£è¯»**ï¼š
```c
int status;
pid_t child_pid = wait(&status);

if (WIFEXITED(status)) {
    printf("å­è¿›ç¨‹æ­£å¸¸é€€å‡ºï¼Œé€€å‡ºç ï¼š%d\n", WEXITSTATUS(status));
} else if (WIFSIGNALED(status)) {
    printf("å­è¿›ç¨‹è¢«ä¿¡å·ç»ˆæ­¢ï¼Œä¿¡å·ï¼š%d\n", WTERMSIG(status));
}
```

**å®Œæ•´çš„çˆ¶å­è¿›ç¨‹åä½œç¤ºä¾‹**ï¼š
```c
#include <unistd.h>
#include <sys/wait.h>
#include <stdio.h>

int main() {
    pid_t pid = fork();
    
    if (pid == 0) {
        // å­è¿›ç¨‹ï¼šæ‰§è¡Œä»»åŠ¡
        printf("å­è¿›ç¨‹å¼€å§‹å·¥ä½œ...\n");
        sleep(2);  // æ¨¡æ‹Ÿå·¥ä½œ
        printf("å­è¿›ç¨‹å·¥ä½œå®Œæˆ\n");
        exit(42);  // ä»¥é€€å‡ºç 42ç»“æŸ
    } else {
        // çˆ¶è¿›ç¨‹ï¼šç­‰å¾…å­è¿›ç¨‹
        printf("çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹å®Œæˆ...\n");
        int status;
        wait(&status);
        printf("å­è¿›ç¨‹å·²å®Œæˆï¼Œé€€å‡ºç ï¼š%d\n", WEXITSTATUS(status));
    }
    
    return 0;
}
```

---

## 4. ğŸ’¾ å†…å­˜ç®¡ç†ç³»ç»Ÿè°ƒç”¨


### 4.1 mmap - å†…å­˜æ˜ å°„


**ä½œç”¨**ï¼šå°†æ–‡ä»¶æˆ–è®¾å¤‡æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œè®©ä½ å¯ä»¥åƒè®¿é—®æ•°ç»„ä¸€æ ·è®¿é—®æ–‡ä»¶å†…å®¹ã€‚

```c
#include <sys/mman.h>
void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);
```

**å†…å­˜æ˜ å°„çš„ç›´è§‚ç†è§£**ï¼š
```
ä¼ ç»Ÿæ–‡ä»¶è¯»å–ï¼š
ç¨‹åº â†’ read() â†’ å†…æ ¸ç¼“å†²åŒº â†’ å¤åˆ¶åˆ°ç¨‹åºå†…å­˜

å†…å­˜æ˜ å°„ï¼š
ç¨‹åºå†…å­˜ â† ç›´æ¥æ˜ å°„ â† æ–‡ä»¶å†…å®¹
```

**å‚æ•°è¯¦è§£**ï¼š

**protï¼ˆä¿æŠ¤æ¨¡å¼ï¼‰**ï¼š
```
PROT_READ     å†…å­˜åŒºåŸŸå¯è¯»
PROT_WRITE    å†…å­˜åŒºåŸŸå¯å†™
PROT_EXEC     å†…å­˜åŒºåŸŸå¯æ‰§è¡Œ
PROT_NONE     å†…å­˜åŒºåŸŸä¸å¯è®¿é—®
```

**flagsï¼ˆæ˜ å°„ç±»å‹ï¼‰**ï¼š
```
MAP_SHARED    å¤šä¸ªè¿›ç¨‹å…±äº«è¿™å—å†…å­˜ï¼Œä¿®æ”¹å¯¹æ‰€æœ‰è¿›ç¨‹å¯è§
MAP_PRIVATE   ç§æœ‰æ˜ å°„ï¼Œä¿®æ”¹åªå¯¹å½“å‰è¿›ç¨‹å¯è§
MAP_ANONYMOUS åŒ¿åæ˜ å°„ï¼Œä¸å…³è”æ–‡ä»¶ï¼ˆç”¨äºåˆ†é…å†…å­˜ï¼‰
```

**å®ç”¨åº”ç”¨åœºæ™¯**ï¼š

**åœºæ™¯1ï¼šé«˜æ•ˆæ–‡ä»¶è¯»å–**
```c
// å°†æ•´ä¸ªæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜
int fd = open("bigfile.dat", O_RDONLY);
struct stat sb;
fstat(fd, &sb);  // è·å–æ–‡ä»¶å¤§å°

char *file_memory = mmap(NULL, sb.st_size, PROT_READ, MAP_SHARED, fd, 0);
if (file_memory == MAP_FAILED) {
    perror("mmapå¤±è´¥");
    return 1;
}

// ç°åœ¨å¯ä»¥åƒæ•°ç»„ä¸€æ ·è®¿é—®æ–‡ä»¶
printf("æ–‡ä»¶ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼š%c\n", file_memory[0]);

munmap(file_memory, sb.st_size);  // å–æ¶ˆæ˜ å°„
close(fd);
```

**åœºæ™¯2ï¼šè¿›ç¨‹é—´å…±äº«å†…å­˜**
```c
// åˆ›å»ºå…±äº«å†…å­˜åŒºåŸŸ
void *shared_mem = mmap(NULL, 4096, PROT_READ | PROT_WRITE, 
                       MAP_SHARED | MAP_ANONYMOUS, -1, 0);

if (fork() == 0) {
    // å­è¿›ç¨‹å†™å…¥æ•°æ®
    strcpy(shared_mem, "Hello from child");
    exit(0);
} else {
    // çˆ¶è¿›ç¨‹ç­‰å¾…å¹¶è¯»å–
    wait(NULL);
    printf("ä»å­è¿›ç¨‹æ”¶åˆ°ï¼š%s\n", (char*)shared_mem);
}
```

### 4.2 brk/sbrk - å †å†…å­˜ç®¡ç†


**ä½œç”¨**ï¼šè°ƒæ•´ç¨‹åºçš„å †ç©ºé—´å¤§å°ï¼Œè¿™æ˜¯malloc()åº•å±‚ä½¿ç”¨çš„ç³»ç»Ÿè°ƒç”¨ã€‚

```c
#include <unistd.h>
int brk(void *addr);
void *sbrk(intptr_t increment);
```

**å †å†…å­˜å¸ƒå±€ç†è§£**ï¼š
```
ç¨‹åºå†…å­˜å¸ƒå±€ï¼š
+-----------------+  â† é«˜åœ°å€
|      æ ˆ         |
+-----------------+
|       â†“         |
|                 |
|       â†‘         |
+-----------------+
|      å †         |  â† brkæŒ‡é’ˆæ§åˆ¶è¿™é‡Œ
+-----------------+
|    æ•°æ®æ®µ       |
+-----------------+
|    ä»£ç æ®µ       |  â† ä½åœ°å€
+-----------------+
```

**å·¥ä½œåŸç†**ï¼š
- **brk()**ï¼šè®¾ç½®å †çš„ç»“æŸåœ°å€
- **sbrk()**ï¼šæŒ‰å¢é‡è°ƒæ•´å †å¤§å°ï¼Œè¿”å›åŸæ¥çš„å †é¡¶åœ°å€
- **malloc()**ï¼šå†…éƒ¨ä½¿ç”¨è¿™äº›ç³»ç»Ÿè°ƒç”¨æ¥åˆ†é…å†…å­˜

> ğŸ’¡ **å®é™…å¼€å‘å»ºè®®**ï¼šç›´æ¥ä½¿ç”¨brk/sbrkæ¯”è¾ƒå¤æ‚ä¸”å®¹æ˜“å‡ºé”™ï¼Œå»ºè®®ä½¿ç”¨malloc/freeç­‰åº“å‡½æ•°ï¼Œå®ƒä»¬å†…éƒ¨ä¼šåˆç†åœ°è°ƒç”¨è¿™äº›ç³»ç»Ÿè°ƒç”¨ã€‚

### 4.3 mprotect - å†…å­˜ä¿æŠ¤


**ä½œç”¨**ï¼šä¿®æ”¹å·²åˆ†é…å†…å­˜åŒºåŸŸçš„è®¿é—®æƒé™ã€‚

```c
#include <sys/mman.h>
int mprotect(void *addr, size_t len, int prot);
```

**åº”ç”¨åœºæ™¯ç¤ºä¾‹**ï¼š
```c
// åˆ†é…å¯è¯»å†™å†…å­˜
void *mem = mmap(NULL, 4096, PROT_READ | PROT_WRITE, 
                MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);

strcpy(mem, "é‡è¦æ•°æ®");

// æ”¹ä¸ºåªè¯»ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹
mprotect(mem, 4096, PROT_READ);

// æ­¤æ—¶å†™å…¥ä¼šå¯¼è‡´æ®µé”™è¯¯
// strcpy(mem, "è¯•å›¾ä¿®æ”¹");  // è¿™ä¼šå´©æºƒ
```

---

## 5. ğŸ“¡ ä¿¡å·å¤„ç†ç³»ç»Ÿè°ƒç”¨


### 5.1 ä¿¡å·åŸºç¡€æ¦‚å¿µ


**ä¿¡å·**å°±åƒæ˜¯è¿›ç¨‹é—´çš„"çŸ­æ¶ˆæ¯"æˆ–"é€šçŸ¥"ï¼Œç”¨æ¥å‘Šè¯‰è¿›ç¨‹å‘ç”Ÿäº†æŸç§äº‹ä»¶ã€‚

**å¸¸è§ä¿¡å·ç±»å‹**ï¼š
```
ğŸ”¸ ç”¨æˆ·è§¦å‘ï¼š
SIGINT (2)    Ctrl+Cï¼Œä¸­æ–­ä¿¡å·
SIGQUIT (3)   Ctrl+\ï¼Œé€€å‡ºä¿¡å·
SIGTSTP (20)  Ctrl+Zï¼Œæš‚åœä¿¡å·

ğŸ”¸ ç³»ç»Ÿè§¦å‘ï¼š
SIGCHLD (17)  å­è¿›ç¨‹çŠ¶æ€æ”¹å˜
SIGALRM (14)  å®šæ—¶å™¨åˆ°æœŸ
SIGPIPE (13)  ç®¡é“ç ´è£‚

ğŸ”¸ ä¸¥é‡é”™è¯¯ï¼š
SIGSEGV (11)  æ®µé”™è¯¯ï¼Œè®¿é—®éæ³•å†…å­˜
SIGFPE (8)    æµ®ç‚¹å¼‚å¸¸ï¼Œé™¤é›¶é”™è¯¯
```

### 5.2 kill - å‘é€ä¿¡å·


**ä½œç”¨**ï¼šå‘æŒ‡å®šè¿›ç¨‹å‘é€ä¿¡å·ã€‚

```c
#include <signal.h>
int kill(pid_t pid, int sig);
```

**å‚æ•°å«ä¹‰**ï¼š
- **pid > 0**ï¼šå‘é€ç»™æŒ‡å®šè¿›ç¨‹
- **pid = 0**ï¼šå‘é€ç»™å½“å‰è¿›ç¨‹ç»„çš„æ‰€æœ‰è¿›ç¨‹
- **pid = -1**ï¼šå‘é€ç»™æ‰€æœ‰æœ‰æƒé™å‘é€çš„è¿›ç¨‹
- **sig = 0**ï¼šä¸å‘é€ä¿¡å·ï¼Œä»…æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨

**å®ç”¨ç¤ºä¾‹**ï¼š
```c
// æ¸©å’Œåœ°ç»ˆæ­¢è¿›ç¨‹
kill(child_pid, SIGTERM);
sleep(5);

// å¦‚æœè¿˜æ²¡ç»“æŸï¼Œå¼ºåˆ¶ç»ˆæ­¢
kill(child_pid, SIGKILL);

// æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿˜æ´»ç€
if (kill(pid, 0) == 0) {
    printf("è¿›ç¨‹ %d ä»åœ¨è¿è¡Œ\n", pid);
}
```

### 5.3 signal - è®¾ç½®ä¿¡å·å¤„ç†


**ä½œç”¨**ï¼šä¸ºä¿¡å·è®¾ç½®å¤„ç†å‡½æ•°ï¼Œå°±åƒç»™æ‰‹æœºè®¾ç½®æ¥ç”µé“ƒå£°ä¸€æ ·ã€‚

```c
#include <signal.h>
typedef void (*sighandler_t)(int);
sighandler_t signal(int signum, sighandler_t handler);
```

**ä¸‰ç§å¤„ç†æ–¹å¼**ï¼š
```
SIG_DFL     ä½¿ç”¨é»˜è®¤å¤„ç†æ–¹å¼
SIG_IGN     å¿½ç•¥è¿™ä¸ªä¿¡å·
è‡ªå®šä¹‰å‡½æ•°   ç”¨æˆ·å®šä¹‰çš„å¤„ç†å‡½æ•°
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```c
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

// ä¿¡å·å¤„ç†å‡½æ•°
void handle_interrupt(int sig) {
    printf("\næ”¶åˆ°ä¸­æ–­ä¿¡å· %dï¼Œä½†æˆ‘ä¸æƒ³é€€å‡ºï¼\n", sig);
}

int main() {
    // è®¾ç½®SIGINTçš„å¤„ç†å‡½æ•°
    signal(SIGINT, handle_interrupt);
    
    printf("è¯•è¯•æŒ‰Ctrl+C...\n");
    while (1) {
        sleep(1);
        printf("ç¨‹åºè¿è¡Œä¸­...\n");
    }
    
    return 0;
}
```

### 5.4 sigaction - é«˜çº§ä¿¡å·å¤„ç†


**ä½œç”¨**ï¼šæä¾›æ¯”signal()æ›´å¼ºå¤§å’Œå¯é çš„ä¿¡å·å¤„ç†æœºåˆ¶ã€‚

```c
#include <signal.h>
int sigaction(int signum, const struct sigaction *act, struct sigaction *oldact);
```

**sigactionç»“æ„ä½“**ï¼š
```c
struct sigaction {
    void (*sa_handler)(int);           // ä¿¡å·å¤„ç†å‡½æ•°
    sigset_t sa_mask;                 // å¤„ç†æœŸé—´å±è”½çš„ä¿¡å·
    int sa_flags;                     // æ§åˆ¶è¡Œä¸ºçš„æ ‡å¿—
};
```

**é«˜çº§åº”ç”¨ç¤ºä¾‹**ï¼š
```c
void advanced_handler(int sig) {
    printf("å¤„ç†ä¿¡å· %dï¼ŒæœŸé—´å…¶ä»–ä¿¡å·è¢«å±è”½\n", sig);
    sleep(2);  // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
}

int main() {
    struct sigaction sa;
    sa.sa_handler = advanced_handler;
    sigemptyset(&sa.sa_mask);
    sigaddset(&sa.sa_mask, SIGQUIT);  // å¤„ç†æœŸé—´å±è”½SIGQUIT
    sa.sa_flags = 0;
    
    sigaction(SIGINT, &sa, NULL);
    
    while (1) {
        pause();  // ç­‰å¾…ä¿¡å·
    }
}
```

---

## 6. â° æ—¶é—´ç›¸å…³ç³»ç»Ÿè°ƒç”¨


### 6.1 gettimeofday - è·å–å½“å‰æ—¶é—´


**ä½œç”¨**ï¼šè·å–å½“å‰çš„ç²¾ç¡®æ—¶é—´ï¼Œç²¾åº¦å¯è¾¾å¾®ç§’çº§åˆ«ã€‚

```c
#include <sys/time.h>
int gettimeofday(struct timeval *tv, struct timezone *tz);
```

**timevalç»“æ„ä½“**ï¼š
```c
struct timeval {
    time_t tv_sec;       // ç§’æ•°ï¼ˆä»1970å¹´1æœˆ1æ—¥å¼€å§‹ï¼‰
    suseconds_t tv_usec; // å¾®ç§’æ•°ï¼ˆ0-999999ï¼‰
};
```

**å®ç”¨ç¤ºä¾‹**ï¼š
```c
#include <sys/time.h>
#include <stdio.h>

void print_current_time() {
    struct timeval tv;
    gettimeofday(&tv, NULL);
    
    printf("å½“å‰æ—¶é—´ï¼š%ld ç§’ %ld å¾®ç§’\n", tv.tv_sec, tv.tv_usec);
    
    // è½¬æ¢ä¸ºå¯è¯»æ ¼å¼
    time_t sec = tv.tv_sec;
    printf("å¯è¯»æ—¶é—´ï¼š%s", ctime(&sec));
}

// è®¡ç®—ç¨‹åºæ‰§è¡Œæ—¶é—´
void measure_execution_time() {
    struct timeval start, end;
    
    gettimeofday(&start, NULL);
    
    // æ‰§è¡ŒæŸäº›æ“ä½œ
    sleep(2);
    
    gettimeofday(&end, NULL);
    
    long elapsed = (end.tv_sec - start.tv_sec) * 1000000 + 
                   (end.tv_usec - start.tv_usec);
    printf("æ‰§è¡Œæ—¶é—´ï¼š%ld å¾®ç§’\n", elapsed);
}
```

### 6.2 nanosleep - é«˜ç²¾åº¦ç¡çœ 


**ä½œç”¨**ï¼šè®©ç¨‹åºæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œç²¾åº¦å¯è¾¾çº³ç§’çº§åˆ«ã€‚

```c
#include <time.h>
int nanosleep(const struct timespec *req, struct timespec *rem);
```

**timespecç»“æ„ä½“**ï¼š
```c
struct timespec {
    time_t tv_sec;  // ç§’æ•°
    long tv_nsec;   // çº³ç§’æ•°ï¼ˆ0-999999999ï¼‰
};
```

**ä¸sleep()çš„å¯¹æ¯”**ï¼š
```c
// ä¼ ç»Ÿsleepï¼šåªèƒ½ç²¾ç¡®åˆ°ç§’
sleep(1);  // ç¡çœ 1ç§’

// nanosleepï¼šå¯ä»¥ç²¾ç¡®åˆ°çº³ç§’
struct timespec req = {1, 500000000};  // 1.5ç§’
nanosleep(&req, NULL);

// æ›´ç²¾ç¡®çš„çŸ­æš‚å»¶è¿Ÿ
struct timespec short_delay = {0, 100000000};  // 0.1ç§’
nanosleep(&short_delay, NULL);
```

**ä¿¡å·ä¸­æ–­å¤„ç†**ï¼š
```c
struct timespec req = {5, 0};  // è¯·æ±‚ç¡çœ 5ç§’
struct timespec rem;

if (nanosleep(&req, &rem) == -1) {
    if (errno == EINTR) {
        printf("ç¡çœ è¢«ä¿¡å·ä¸­æ–­ï¼Œå‰©ä½™æ—¶é—´ï¼š%ld.%09ldç§’\n", 
               rem.tv_sec, rem.tv_nsec);
    }
}
```

### 6.3 æ—¶é—´ç›¸å…³çš„å®é™…åº”ç”¨


**åº”ç”¨åœºæ™¯1ï¼šæ€§èƒ½æµ‹è¯•**
```c
// æµ‹è¯•å‡½æ•°æ‰§è¡Œæ—¶é—´
struct timespec start, end;
clock_gettime(CLOCK_MONOTONIC, &start);

// æ‰§è¡Œè¦æµ‹è¯•çš„å‡½æ•°
some_function();

clock_gettime(CLOCK_MONOTONIC, &end);

long elapsed_ns = (end.tv_sec - start.tv_sec) * 1000000000L + 
                  (end.tv_nsec - start.tv_nsec);
printf("å‡½æ•°æ‰§è¡Œæ—¶é—´ï¼š%ld çº³ç§’\n", elapsed_ns);
```

**åº”ç”¨åœºæ™¯2ï¼šå®šæ—¶ä»»åŠ¡**
```c
void periodic_task() {
    struct timespec interval = {1, 0};  // æ¯ç§’æ‰§è¡Œä¸€æ¬¡
    
    while (1) {
        printf("æ‰§è¡Œå®šæ—¶ä»»åŠ¡...\n");
        // æ‰§è¡Œå…·ä½“ä»»åŠ¡
        
        nanosleep(&interval, NULL);
    }
}
```

---

## 7. ğŸ“‚ æ–‡ä»¶ç³»ç»Ÿæ“ä½œè°ƒç”¨


### 7.1 statç³»åˆ— - è·å–æ–‡ä»¶ä¿¡æ¯


**ä½œç”¨**ï¼šè·å–æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚å¤§å°ã€æƒé™ã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚

```c
#include <sys/stat.h>
int stat(const char *pathname, struct stat *statbuf);
int lstat(const char *pathname, struct stat *statbuf);  // ä¸è·Ÿéšç¬¦å·é“¾æ¥
int fstat(int fd, struct stat *statbuf);               // é€šè¿‡æ–‡ä»¶æè¿°ç¬¦
```

**statç»“æ„ä½“é‡è¦å­—æ®µ**ï¼š
```c
struct stat {
    mode_t st_mode;    // æ–‡ä»¶ç±»å‹å’Œæƒé™
    uid_t st_uid;      // æ‰€æœ‰è€…ç”¨æˆ·ID
    gid_t st_gid;      // æ‰€æœ‰è€…ç»„ID
    off_t st_size;     // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    time_t st_mtime;   // æœ€åä¿®æ”¹æ—¶é—´
    time_t st_atime;   // æœ€åè®¿é—®æ—¶é—´
    time_t st_ctime;   // çŠ¶æ€æ”¹å˜æ—¶é—´
};
```

**æ–‡ä»¶ç±»å‹åˆ¤æ–­å®**ï¼š
```c
S_ISREG(mode)   // æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶
S_ISDIR(mode)   // æ˜¯å¦ä¸ºç›®å½•
S_ISLNK(mode)   // æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥
S_ISFIFO(mode)  // æ˜¯å¦ä¸ºå‘½åç®¡é“
S_ISSOCK(mode)  // æ˜¯å¦ä¸ºå¥—æ¥å­—
```

**å®ç”¨ç¤ºä¾‹**ï¼š
```c
#include <sys/stat.h>
#include <stdio.h>
#include <time.h>

void print_file_info(const char *filename) {
    struct stat file_stat;
    
    if (stat(filename, &file_stat) == -1) {
        perror("è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥");
        return;
    }
    
    printf("æ–‡ä»¶ï¼š%s\n", filename);
    printf("å¤§å°ï¼š%ld å­—èŠ‚\n", file_stat.st_size);
    
    // æ–‡ä»¶ç±»å‹
    if (S_ISREG(file_stat.st_mode)) {
        printf("ç±»å‹ï¼šæ™®é€šæ–‡ä»¶\n");
    } else if (S_ISDIR(file_stat.st_mode)) {
        printf("ç±»å‹ï¼šç›®å½•\n");
    }
    
    // æƒé™ï¼ˆå…«è¿›åˆ¶è¡¨ç¤ºï¼‰
    printf("æƒé™ï¼š%o\n", file_stat.st_mode & 0777);
    
    // ä¿®æ”¹æ—¶é—´
    printf("ä¿®æ”¹æ—¶é—´ï¼š%s", ctime(&file_stat.st_mtime));
}
```

### 7.2 chmod/fchmod - ä¿®æ”¹æ–‡ä»¶æƒé™


**ä½œç”¨**ï¼šä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æƒé™ã€‚

```c
#include <sys/stat.h>
int chmod(const char *pathname, mode_t mode);
int fchmod(int fd, mode_t mode);
```

**æƒé™ä½ç†è§£**ï¼š
```
æƒé™è¡¨ç¤ºæ³•ï¼š
ç”¨æˆ·(u) ç»„(g) å…¶ä»–(o)
rwx     rwx    rwx
421     421    421

ç¤ºä¾‹ï¼š
0755 = rwxr-xr-x = ç”¨æˆ·å…¨æƒé™ï¼Œç»„å’Œå…¶ä»–å¯è¯»æ‰§è¡Œ
0644 = rw-r--r-- = ç”¨æˆ·å¯è¯»å†™ï¼Œç»„å’Œå…¶ä»–åªè¯»
0600 = rw------- = åªæœ‰ç”¨æˆ·å¯è¯»å†™
```

**å®ç”¨ç¤ºä¾‹**ï¼š
```c
// è®¾ç½®æ–‡ä»¶ä¸ºç”¨æˆ·å¯è¯»å†™ï¼Œå…¶ä»–äººåªè¯»
chmod("config.txt", 0644);

// è®¾ç½®è„šæœ¬ä¸ºå¯æ‰§è¡Œ
chmod("script.sh", 0755);

// è®¾ç½®ç§å¯†æ–‡ä»¶åªæœ‰è‡ªå·±èƒ½è®¿é—®
chmod("private.key", 0600);

// æ‰¹é‡ä¿®æ”¹ç›®å½•ä¸‹çš„æ–‡ä»¶æƒé™
void make_scripts_executable(const char *dir_path) {
    // è¿™é‡Œéœ€è¦é…åˆopendir/readdirä½¿ç”¨
    chmod("script1.sh", 0755);
    chmod("script2.sh", 0755);
}
```

### 7.3 chown/fchown - ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…


**ä½œç”¨**ï¼šä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„ã€‚

```c
#include <unistd.h>
int chown(const char *pathname, uid_t owner, gid_t group);
int fchown(int fd, uid_t owner, gid_t group);
```

**å‚æ•°è¯´æ˜**ï¼š
- **owner**ï¼šæ–°çš„ç”¨æˆ·IDï¼Œ-1è¡¨ç¤ºä¸æ”¹å˜
- **group**ï¼šæ–°çš„ç»„IDï¼Œ-1è¡¨ç¤ºä¸æ”¹å˜

**å®é™…åº”ç”¨**ï¼š
```c
#include <pwd.h>
#include <grp.h>

// é€šè¿‡ç”¨æˆ·åè·å–UID
struct passwd *pw = getpwnam("nginx");
struct group *gr = getgrnam("nginx");

if (pw && gr) {
    // å°†webç›®å½•çš„æ‰€æœ‰æƒè½¬ç»™nginxç”¨æˆ·
    chown("/var/www", pw->pw_uid, gr->gr_gid);
}

// åªä¿®æ”¹ç»„ï¼Œä¿æŒç”¨æˆ·ä¸å˜
chown("shared_file.txt", -1, gr->gr_gid);
```

---

## 8. ğŸŒ ç½‘ç»œç›¸å…³ç³»ç»Ÿè°ƒç”¨


### 8.1 socket - åˆ›å»ºå¥—æ¥å­—


**ä½œç”¨**ï¼šåˆ›å»ºä¸€ä¸ªç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ï¼Œå°±åƒæ˜¯ç”³è¯·ä¸€ä¸ªç”µè¯å·ç ã€‚

```c
#include <sys/socket.h>
int socket(int domain, int type, int protocol);
```

**å‚æ•°è¯¦è§£**ï¼š

**domainï¼ˆåè®®æ—ï¼‰**ï¼š
```
AF_INET     IPv4ç½‘ç»œåè®®
AF_INET6    IPv6ç½‘ç»œåè®®  
AF_UNIX     æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡
```

**typeï¼ˆå¥—æ¥å­—ç±»å‹ï¼‰**ï¼š
```
SOCK_STREAM   TCPåè®®ï¼Œå¯é çš„å­—èŠ‚æµ
SOCK_DGRAM    UDPåè®®ï¼Œä¸å¯é çš„æ•°æ®æŠ¥
SOCK_RAW      åŸå§‹å¥—æ¥å­—ï¼Œç”¨äºç‰¹æ®Šåè®®
```

**åˆ›å»ºä¸åŒç±»å‹å¥—æ¥å­—**ï¼š
```c
// TCPå¥—æ¥å­—ï¼ˆç”¨äºå¯é è¿æ¥ï¼‰
int tcp_sock = socket(AF_INET, SOCK_STREAM, 0);

// UDPå¥—æ¥å­—ï¼ˆç”¨äºå¿«é€Ÿé€šä¿¡ï¼‰
int udp_sock = socket(AF_INET, SOCK_DGRAM, 0);

// æœ¬åœ°å¥—æ¥å­—ï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰
int local_sock = socket(AF_UNIX, SOCK_STREAM, 0);
```

### 8.2 bind - ç»‘å®šåœ°å€


**ä½œç”¨**ï¼šå°†å¥—æ¥å­—ç»‘å®šåˆ°å…·ä½“çš„IPåœ°å€å’Œç«¯å£ï¼Œå°±åƒæ˜¯ç»™ç”µè¯åˆ†é…å·ç ã€‚

```c
#include <sys/socket.h>
int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
```

**åœ°å€ç»“æ„è®¾ç½®**ï¼š
```c
#include <netinet/in.h>
#include <arpa/inet.h>

struct sockaddr_in server_addr;
server_addr.sin_family = AF_INET;           // IPv4
server_addr.sin_port = htons(8080);         // ç«¯å£8080
server_addr.sin_addr.s_addr = INADDR_ANY;   // ç›‘å¬æ‰€æœ‰IP

// ç»‘å®šåˆ°å¥—æ¥å­—
bind(sockfd, (struct sockaddr*)&server_addr, sizeof(server_addr));
```

**å¸¸ç”¨ç»‘å®šæ¨¡å¼**ï¼š
```c
// ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£çš„8080ç«¯å£
server_addr.sin_addr.s_addr = INADDR_ANY;

// åªç»‘å®šåˆ°æœ¬åœ°å›ç¯æ¥å£
inet_pton(AF_INET, "127.0.0.1", &server_addr.sin_addr);

// ç»‘å®šåˆ°ç‰¹å®šIPåœ°å€
inet_pton(AF_INET, "192.168.1.100", &server_addr.sin_addr);
```

### 8.3 listen - ç›‘å¬è¿æ¥


**ä½œç”¨**ï¼šè®©å¥—æ¥å­—è¿›å…¥ç›‘å¬çŠ¶æ€ï¼Œå‡†å¤‡æ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚

```c
#include <sys/socket.h>
int listen(int sockfd, int backlog);
```

**backlogå‚æ•°**ï¼šç­‰å¾…è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦
```c
// åˆ›å»ºTCPæœåŠ¡å™¨çš„å®Œæ•´æµç¨‹
int server_sock = socket(AF_INET, SOCK_STREAM, 0);

struct sockaddr_in addr;
addr.sin_family = AF_INET;
addr.sin_port = htons(8080);
addr.sin_addr.s_addr = INADDR_ANY;

bind(server_sock, (struct sockaddr*)&addr, sizeof(addr));
listen(server_sock, 5);  // æœ€å¤š5ä¸ªç­‰å¾…è¿æ¥

printf("æœåŠ¡å™¨åœ¨8080ç«¯å£ç­‰å¾…è¿æ¥...\n");
```

### 8.4 ç®€å•TCPæœåŠ¡å™¨ç¤ºä¾‹


```c
#include <sys/socket.h>
#include <netinet/in.h>
#include <stdio.h>
#include <unistd.h>
#include <string.h>

int main() {
    // 1. åˆ›å»ºå¥—æ¥å­—
    int server_sock = socket(AF_INET, SOCK_STREAM, 0);
    
    // 2. è®¾ç½®åœ°å€
    struct sockaddr_in server_addr;
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(8080);
    server_addr.sin_addr.s_addr = INADDR_ANY;
    
    // 3. ç»‘å®šåœ°å€
    bind(server_sock, (struct sockaddr*)&server_addr, sizeof(server_addr));
    
    // 4. å¼€å§‹ç›‘å¬
    listen(server_sock, 5);
    printf("æœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£8080...\n");
    
    // 5. æ¥å—è¿æ¥
    struct sockaddr_in client_addr;
    socklen_t client_len = sizeof(client_addr);
    int client_sock = accept(server_sock, (struct sockaddr*)&client_addr, &client_len);
    
    // 6. å¤„ç†æ•°æ®
    char buffer[1024];
    read(client_sock, buffer, sizeof(buffer));
    printf("æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯ï¼š%s\n", buffer);
    
    write(client_sock, "Hello Client!", 13);
    
    // 7. å…³é—­è¿æ¥
    close(client_sock);
    close(server_sock);
    
    return 0;
}
```

---

## 9. ğŸ”„ è¿›ç¨‹é—´é€šä¿¡è°ƒç”¨


### 9.1 pipe - åˆ›å»ºç®¡é“


**ä½œç”¨**ï¼šåˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œç”¨äºçˆ¶å­è¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œå°±åƒæ˜¯ä¸¤ä¸ªè¿›ç¨‹é—´çš„"æ°´ç®¡"ã€‚

```c
#include <unistd.h>
int pipe(int pipefd[2]);
```

**ç®¡é“çš„å·¥ä½œåŸç†**ï¼š
```
çˆ¶è¿›ç¨‹                    å­è¿›ç¨‹
   |                        |
   |--å†™å…¥æ•°æ®-->pipefd[1]   |
   |                 |      |
   |                 â†“      |
   |              å†…æ ¸ç¼“å†²åŒº  |
   |                 |      |
   |                 â†“      |
   |            pipefd[0]<--è¯»å–æ•°æ®--|
```

**è¿”å›å€¼è¯´æ˜**ï¼š
- **pipefd[0]**ï¼šè¯»å–ç«¯æ–‡ä»¶æè¿°ç¬¦
- **pipefd[1]**ï¼šå†™å…¥ç«¯æ–‡ä»¶æè¿°ç¬¦

**å®ç”¨ç¤ºä¾‹**ï¼š
```c
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int main() {
    int pipefd[2];
    
    // åˆ›å»ºç®¡é“
    if (pipe(pipefd) == -1) {
        perror("åˆ›å»ºç®¡é“å¤±è´¥");
        return 1;
    }
    
    pid_t pid = fork();
    
    if (pid == 0) {
        // å­è¿›ç¨‹ï¼šä»ç®¡é“è¯»å–æ•°æ®
        close(pipefd[1]);  // å…³é—­å†™ç«¯
        
        char buffer[100];
        read(pipefd[0], buffer, sizeof(buffer));
        printf("å­è¿›ç¨‹æ”¶åˆ°ï¼š%s\n", buffer);
        
        close(pipefd[0]);
    } else {
        // çˆ¶è¿›ç¨‹ï¼šå‘ç®¡é“å†™å…¥æ•°æ®
        close(pipefd[0]);  // å…³é—­è¯»ç«¯
        
        const char *message = "Hello from parent!";
        write(pipefd[1], message, strlen(message) + 1);
        
        close(pipefd[1]);
        wait(NULL);  // ç­‰å¾…å­è¿›ç¨‹
    }
    
    return 0;
}
```

### 9.2 å‘½åç®¡é“ï¼ˆFIFOï¼‰


**ä½œç”¨**ï¼šåˆ›å»ºä¸€ä¸ªæœ‰åå­—çš„ç®¡é“æ–‡ä»¶ï¼Œä¸ç›¸å…³çš„è¿›ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡å®ƒé€šä¿¡ã€‚

```c
#include <sys/stat.h>
int mkfifo(const char *pathname, mode_t mode);
```

**å‘½åç®¡é“çš„ç‰¹ç‚¹**ï¼š
- åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰å®é™…çš„æ–‡ä»¶å
- ä¸ç›¸å…³çš„è¿›ç¨‹å¯ä»¥é€šè¿‡æ–‡ä»¶åæ‰¾åˆ°å®ƒ
- æ•°æ®ä»ç„¶å­˜å‚¨åœ¨å†…æ ¸ç¼“å†²åŒºä¸­

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

**åˆ›å»ºå‘½åç®¡é“**ï¼š
```c
// åˆ›å»ºå‘½åç®¡é“
mkfifo("/tmp/my_pipe", 0666);

// å†™å…¥è¿›ç¨‹
int fd = open("/tmp/my_pipe", O_WRONLY);
write(fd, "Hello FIFO!", 11);
close(fd);
```

**è¯»å–è¿›ç¨‹ï¼ˆå¯ä»¥æ˜¯å®Œå…¨ä¸åŒçš„ç¨‹åºï¼‰**ï¼š
```c
// è¯»å–è¿›ç¨‹
int fd = open("/tmp/my_pipe", O_RDONLY);
char buffer[100];
read(fd, buffer, sizeof(buffer));
printf("ä»FIFOæ”¶åˆ°ï¼š%s\n", buffer);
close(fd);
```

### 9.3 msgget - æ¶ˆæ¯é˜Ÿåˆ—


**ä½œç”¨**ï¼šåˆ›å»ºæˆ–è·å–ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºè¿›ç¨‹é—´ä¼ é€’ç»“æ„åŒ–æ¶ˆæ¯ã€‚

```c
#include <sys/msg.h>
int msgget(key_t key, int msgflg);
```

**æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜åŠ¿**ï¼š
- å¯ä»¥ä¼ é€’ç»“æ„åŒ–æ•°æ®
- æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§
- æ¶ˆæ¯æœ‰è¾¹ç•Œï¼Œä¸ä¼šæ··æ·†

**åŸºæœ¬ä½¿ç”¨æµç¨‹**ï¼š
```c
#include <sys/msg.h>
#include <sys/ipc.h>

// æ¶ˆæ¯ç»“æ„ä½“
struct message {
    long msg_type;      // æ¶ˆæ¯ç±»å‹
    char msg_text[100]; // æ¶ˆæ¯å†…å®¹
};

int main() {
    // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—
    key_t key = ftok("/tmp", 'A');  // ç”Ÿæˆå”¯ä¸€é”®å€¼
    int msgid = msgget(key, IPC_CREAT | 0666);
    
    if (fork() == 0) {
        // å­è¿›ç¨‹ï¼šå‘é€æ¶ˆæ¯
        struct message msg;
        msg.msg_type = 1;
        strcpy(msg.msg_text, "Hello from child!");
        msgsnd(msgid, &msg, strlen(msg.msg_text) + 1, 0);
        exit(0);
    } else {
        // çˆ¶è¿›ç¨‹ï¼šæ¥æ”¶æ¶ˆæ¯
        struct message msg;
        msgrcv(msgid, &msg, sizeof(msg.msg_text), 1, 0);
        printf("æ”¶åˆ°æ¶ˆæ¯ï¼š%s\n", msg.msg_text);
        
        // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—
        msgctl(msgid, IPC_RMID, NULL);
        wait(NULL);
    }
    
    return 0;
}
```

**IPCæœºåˆ¶å¯¹æ¯”æ€»ç»“**ï¼š

| æœºåˆ¶ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| ğŸ”§ **ç®¡é“** | `ç®€å•æ˜“ç”¨ï¼Œè‡ªåŠ¨æ¸…ç†` | `åªèƒ½çˆ¶å­è¿›ç¨‹ä½¿ç”¨` | `çˆ¶å­è¿›ç¨‹é—´ç®€å•é€šä¿¡` |
| ğŸ“ **å‘½åç®¡é“** | `ä»»æ„è¿›ç¨‹å¯ç”¨` | `éœ€è¦æ–‡ä»¶ç³»ç»Ÿæ”¯æŒ` | `ä¸ç›¸å…³è¿›ç¨‹é—´é€šä¿¡` |
| ğŸ“¨ **æ¶ˆæ¯é˜Ÿåˆ—** | `ç»“æ„åŒ–æ•°æ®ï¼Œæœ‰ä¼˜å…ˆçº§` | `ç³»ç»Ÿèµ„æºé™åˆ¶` | `å¤æ‚çš„è¿›ç¨‹é—´æ¶ˆæ¯ä¼ é€’` |

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç³»ç»Ÿè°ƒç”¨æœ¬è´¨ï¼šåº”ç”¨ç¨‹åºä¸å†…æ ¸ä¹‹é—´çš„æ ‡å‡†æ¥å£
ğŸ”¸ æ–‡ä»¶æ“ä½œï¼šopen/read/write/closeæ˜¯æ‰€æœ‰I/Oçš„åŸºç¡€
ğŸ”¸ è¿›ç¨‹æ§åˆ¶ï¼šforkåˆ›å»ºï¼Œexecæ›¿æ¢ï¼Œwaitç­‰å¾…
ğŸ”¸ å†…å­˜ç®¡ç†ï¼šmmapé«˜æ•ˆæ–‡ä»¶è®¿é—®ï¼Œbrkå †ç®¡ç†
ğŸ”¸ ä¿¡å·æœºåˆ¶ï¼šè¿›ç¨‹é—´çš„å¼‚æ­¥é€šçŸ¥æœºåˆ¶
ğŸ”¸ æ—¶é—´æœåŠ¡ï¼šgettimeofdayç²¾ç¡®æ—¶é—´ï¼Œnanosleepç²¾ç¡®å»¶è¿Ÿ
ğŸ”¸ æ–‡ä»¶ç³»ç»Ÿï¼šstatè·å–ä¿¡æ¯ï¼Œchmod/chownä¿®æ”¹å±æ€§
ğŸ”¸ ç½‘ç»œç¼–ç¨‹ï¼šsocket/bind/listenæ„å»ºç½‘ç»œæœåŠ¡
ğŸ”¸ è¿›ç¨‹é€šä¿¡ï¼špipe/msggetç­‰IPCæœºåˆ¶
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç³»ç»Ÿè°ƒç”¨çš„æ€§èƒ½è€ƒè™‘**
```
ç³»ç»Ÿè°ƒç”¨å¼€é”€ï¼š
- ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢æœ‰æ€§èƒ½ä»£ä»·
- é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ä¼šå½±å“ç¨‹åºæ€§èƒ½
- æ‰¹é‡æ“ä½œæ¯”å•æ¬¡æ“ä½œæ›´é«˜æ•ˆ

ä¼˜åŒ–ç­–ç•¥ï¼š
- ä½¿ç”¨ç¼“å†²I/Oå‡å°‘read/writeæ¬¡æ•°
- mmapä»£æ›¿é¢‘ç¹çš„read/write
- åˆç†è®¾ç½®ç¼“å†²åŒºå¤§å°
```

**ğŸ”¹ é”™è¯¯å¤„ç†çš„é‡è¦æ€§**
```
ç³»ç»Ÿè°ƒç”¨å¿…é¡»æ£€æŸ¥è¿”å›å€¼ï¼š
- æˆåŠŸï¼šé€šå¸¸è¿”å›éè´Ÿæ•°
- å¤±è´¥ï¼šè¿”å›-1ï¼Œè®¾ç½®errno

é”™è¯¯å¤„ç†æ¨¡å¼ï¼š
if (syscall(...) == -1) {
    perror("æ“ä½œå¤±è´¥");
    // é€‚å½“çš„é”™è¯¯å¤„ç†
}
```

**ğŸ”¹ èµ„æºç®¡ç†åŸåˆ™**
```
æ‰“å¼€å¿…é¡»å…³é—­ï¼š
- æ¯ä¸ªopen()å¯¹åº”close()
- æ¯ä¸ªmmap()å¯¹åº”munmap()
- æ¯ä¸ªmalloc()å¯¹åº”free()

é¿å…èµ„æºæ³„éœ²ï¼š
- æ–‡ä»¶æè¿°ç¬¦æ³„éœ²
- å†…å­˜æ³„éœ²
- è¿›ç¨‹åƒµå°¸çŠ¶æ€
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“š å­¦ä¹ å»ºè®®**ï¼š
- **å…ˆç†è§£æ¦‚å¿µ**ï¼šæ¯ä¸ªç³»ç»Ÿè°ƒç”¨è§£å†³ä»€ä¹ˆé—®é¢˜
- **åŠ¨æ‰‹å®è·µ**ï¼šç¼–å†™ç®€å•çš„æµ‹è¯•ç¨‹åº
- **æŸ¥é˜…æ‰‹å†Œ**ï¼š`man 2 open` æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
- **é”™è¯¯å¤„ç†**ï¼šå§‹ç»ˆæ£€æŸ¥è¿”å›å€¼å’Œerrno
- **æ€§èƒ½æ„è¯†**ï¼šäº†è§£ç³»ç»Ÿè°ƒç”¨çš„æ€§èƒ½ç‰¹ç‚¹

**ğŸ› ï¸ å¼€å‘å®è·µ**ï¼š
- **æ–‡ä»¶æ“ä½œ**ï¼šå¤„ç†é…ç½®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶
- **è¿›ç¨‹ç®¡ç†**ï¼šç¼–å†™å®ˆæŠ¤è¿›ç¨‹ã€æœåŠ¡ç¨‹åº
- **ç½‘ç»œç¼–ç¨‹**ï¼šæ„å»ºå®¢æˆ·ç«¯æœåŠ¡å™¨ç¨‹åº
- **ç³»ç»Ÿå·¥å…·**ï¼šç¼–å†™ç³»ç»Ÿç®¡ç†è„šæœ¬å’Œå·¥å…·

**âš ï¸ å¸¸è§é™·é˜±**ï¼š
- å¿˜è®°æ£€æŸ¥ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼
- ä¸æ­£ç¡®çš„é”™è¯¯å¤„ç†
- èµ„æºæ³„éœ²ï¼ˆæ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜ï¼‰
- ä¿¡å·å¤„ç†çš„ç«æ€æ¡ä»¶
- ç½‘ç»œç¼–ç¨‹çš„å­—èŠ‚åºé—®é¢˜

### 10.4 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸš€ æ·±å…¥å†…æ ¸**ï¼š
- Linuxå†…æ ¸æºç åˆ†æ
- ç³»ç»Ÿè°ƒç”¨çš„å†…æ ¸å®ç°
- è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVFSï¼‰
- è¿›ç¨‹è°ƒåº¦ç®—æ³•

**ğŸŒ ç½‘ç»œç¼–ç¨‹**ï¼š
- é«˜å¹¶å‘æœåŠ¡å™¨è®¾è®¡
- epoll/selectç­‰I/Oå¤šè·¯å¤ç”¨
- å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹
- ç½‘ç»œåè®®æ ˆæ·±å…¥

**ğŸ”§ ç³»ç»Ÿä¼˜åŒ–**ï¼š
- æ€§èƒ½åˆ†æå·¥å…·ä½¿ç”¨
- å†…å­˜ç®¡ç†ä¼˜åŒ–
- I/Oæ€§èƒ½è°ƒä¼˜
- ç³»ç»Ÿç›‘æ§å’Œè¯Šæ–­

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç³»ç»Ÿè°ƒç”¨æ˜¯ç¨‹åºä¸å†…æ ¸çš„æ¡¥æ¢
- æ¯ä¸ªè°ƒç”¨éƒ½è¦æ£€æŸ¥è¿”å›å€¼
- æ‰“å¼€çš„èµ„æºå¿…é¡»æ­£ç¡®å…³é—­
- ç†è§£æ¦‚å¿µæ¯”è®°ä½å‚æ•°æ›´é‡è¦
- å®è·µæ˜¯æŒæ¡ç³»ç»Ÿè°ƒç”¨çš„æœ€ä½³é€”å¾„