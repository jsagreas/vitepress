---
title: 6ã€é©±åŠ¨ç¨‹åºå¼€å‘åŸºç¡€
---
## ğŸ“š ç›®å½•

1. [é©±åŠ¨ç¨‹åºåŸºç¡€æ¦‚å¿µ](#1-é©±åŠ¨ç¨‹åºåŸºç¡€æ¦‚å¿µ)
2. [å­—ç¬¦è®¾å¤‡é©±åŠ¨æ¡†æ¶](#2-å­—ç¬¦è®¾å¤‡é©±åŠ¨æ¡†æ¶)
3. [å—è®¾å¤‡é©±åŠ¨æ¡†æ¶](#3-å—è®¾å¤‡é©±åŠ¨æ¡†æ¶)
4. [ç½‘ç»œè®¾å¤‡é©±åŠ¨æ¡†æ¶](#4-ç½‘ç»œè®¾å¤‡é©±åŠ¨æ¡†æ¶)
5. [å¹³å°è®¾å¤‡é©±åŠ¨æ¨¡å‹](#5-å¹³å°è®¾å¤‡é©±åŠ¨æ¨¡å‹)
6. [é©±åŠ¨ç¨‹åºæ³¨å†Œä¸æ³¨é”€](#6-é©±åŠ¨ç¨‹åºæ³¨å†Œä¸æ³¨é”€)
7. [æ–‡ä»¶æ“ä½œæ¥å£å®ç°](#7-æ–‡ä»¶æ“ä½œæ¥å£å®ç°)
8. [é©±åŠ¨è°ƒè¯•æŠ€æœ¯](#8-é©±åŠ¨è°ƒè¯•æŠ€æœ¯)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ é©±åŠ¨ç¨‹åºåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é©±åŠ¨ç¨‹åº


**é€šä¿—ç†è§£**ï¼šé©±åŠ¨ç¨‹åºå°±åƒæ˜¯"ç¿»è¯‘å®˜"ï¼Œå®ƒå¸®åŠ©æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶è®¾å¤‡è¿›è¡Œæ²Ÿé€šã€‚

```
ç”¨æˆ·ç¨‹åº    â†’    æ“ä½œç³»ç»Ÿ    â†’    é©±åŠ¨ç¨‹åº    â†’    ç¡¬ä»¶è®¾å¤‡
   â†“              â†“              â†“              â†“
å†™å…¥æ–‡ä»¶      writeç³»ç»Ÿè°ƒç”¨     æ§åˆ¶ç¡¬ç›˜      å®é™…å­˜å‚¨
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **ç¡¬ä»¶æŠ½è±¡**ï¼šæŠŠå¤æ‚çš„ç¡¬ä»¶æ“ä½œå˜æˆç®€å•çš„ç³»ç»Ÿè°ƒç”¨
- ğŸ”¸ **æ¥å£ç»Ÿä¸€**ï¼šä¸åŒå‚å•†çš„ç›¸åŒç±»å‹è®¾å¤‡ä½¿ç”¨ç›¸åŒæ¥å£
- ğŸ”¸ **èµ„æºç®¡ç†**ï¼šç®¡ç†ç¡¬ä»¶èµ„æºçš„åˆ†é…å’Œé‡Šæ”¾
- ğŸ”¸ **ä¸­æ–­å¤„ç†**ï¼šå¤„ç†ç¡¬ä»¶äº§ç”Ÿçš„ä¸­æ–­ä¿¡å·

### 1.2 Linuxè®¾å¤‡åˆ†ç±»


Linuxå°†è®¾å¤‡åˆ†ä¸ºä¸‰å¤§ç±»ï¼Œæ¯ç±»æœ‰ä¸åŒçš„ç‰¹ç‚¹ï¼š

| è®¾å¤‡ç±»å‹ | **ç‰¹ç‚¹** | **è®¿é—®æ–¹å¼** | **å…¸å‹è®¾å¤‡** |
|---------|----------|-------------|-------------|
| ğŸ”¤ **å­—ç¬¦è®¾å¤‡** | `æŒ‰å­—èŠ‚æµè®¿é—®ï¼Œæ— ç¼“å†²` | `ç›´æ¥è¯»å†™` | `é”®ç›˜ã€é¼ æ ‡ã€ä¸²å£` |
| ğŸ’¾ **å—è®¾å¤‡** | `æŒ‰å—è®¿é—®ï¼Œæœ‰ç¼“å†²` | `éšæœºè®¿é—®` | `ç¡¬ç›˜ã€Uç›˜ã€å…‰ç›˜` |
| ğŸŒ **ç½‘ç»œè®¾å¤‡** | `æ•°æ®åŒ…ä¼ è¾“` | `å¥—æ¥å­—æ¥å£` | `ç½‘å¡ã€WiFié€‚é…å™¨` |

### 1.3 é©±åŠ¨ç¨‹åºåœ¨å†…æ ¸ä¸­çš„ä½ç½®


```
ç”¨æˆ·ç©ºé—´
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨ç¨‹åº (viã€cpã€firefoxç­‰)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ç³»ç»Ÿè°ƒç”¨
å†…æ ¸ç©ºé—´          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ (VFS)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     å­—ç¬¦è®¾å¤‡     â”‚  å—è®¾å¤‡  â”‚ ç½‘ç»œè®¾å¤‡â”‚
â”‚     é©±åŠ¨å±‚       â”‚  é©±åŠ¨å±‚  â”‚  é©±åŠ¨å±‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ç¡¬ä»¶æŠ½è±¡å±‚ (HAL)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
ç¡¬ä»¶å±‚            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å®é™…ç¡¬ä»¶è®¾å¤‡                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“ å­—ç¬¦è®¾å¤‡é©±åŠ¨æ¡†æ¶


### 2.1 å­—ç¬¦è®¾å¤‡çš„ç‰¹ç‚¹


**ä»€ä¹ˆæ˜¯å­—ç¬¦è®¾å¤‡**ï¼šåƒå¤„ç†æ–‡ä»¶ä¸€æ ·ï¼Œä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°è¯»å†™æ•°æ®çš„è®¾å¤‡ã€‚

**å…¸å‹ç‰¹å¾**ï¼š
- ğŸ”¸ **é¡ºåºè®¿é—®**ï¼šæ•°æ®æŒ‰é¡ºåºè¯»å–ï¼Œä¸èƒ½è·³è·ƒ
- ğŸ”¸ **æ— ç¼“å†²**ï¼šç›´æ¥ä¸ç¡¬ä»¶äº¤äº’ï¼Œæ²¡æœ‰ç³»ç»Ÿç¼“å­˜
- ğŸ”¸ **ç®€å•æ¥å£**ï¼šæ”¯æŒ `open`ã€`read`ã€`write`ã€`close` ç­‰åŸºæœ¬æ“ä½œ

### 2.2 å­—ç¬¦è®¾å¤‡é©±åŠ¨æ ¸å¿ƒç»“æ„


**ä¸»è¦ç»„ä»¶**ï¼š

```
å­—ç¬¦è®¾å¤‡é©±åŠ¨ = è®¾å¤‡å· + æ–‡ä»¶æ“ä½œç»“æ„ + æ³¨å†Œå‡½æ•°

è®¾å¤‡å·ï¼š     major:minor (ä¸»è®¾å¤‡å·:æ¬¡è®¾å¤‡å·)
æ–‡ä»¶æ“ä½œï¼š   file_operations ç»“æ„ä½“
æ³¨å†Œï¼š       register_chrdev() å‡½æ•°
```

**æ–‡ä»¶æ“ä½œç»“æ„ä½“** `file_operations`ï¼š
```c
struct file_operations {
    struct module *owner;           // æ¨¡å—æ‰€æœ‰è€…
    int (*open)(struct inode *, struct file *);     // æ‰“å¼€è®¾å¤‡
    int (*release)(struct inode *, struct file *);  // å…³é—­è®¾å¤‡  
    ssize_t (*read)(struct file *, char __user *, size_t, loff_t *);   // è¯»æ•°æ®
    ssize_t (*write)(struct file *, const char __user *, size_t, loff_t *); // å†™æ•°æ®
    long (*unlocked_ioctl)(struct file *, unsigned int, unsigned long); // æ§åˆ¶æ¥å£
};
```

### 2.3 å­—ç¬¦è®¾å¤‡é©±åŠ¨å¼€å‘æ­¥éª¤


**å¼€å‘æµç¨‹**ï¼š

1ï¸âƒ£ **å®šä¹‰æ–‡ä»¶æ“ä½œå‡½æ•°**
2ï¸âƒ£ **å¡«å…… file_operations ç»“æ„**  
3ï¸âƒ£ **ç”³è¯·è®¾å¤‡å·**
4ï¸âƒ£ **æ³¨å†Œå­—ç¬¦è®¾å¤‡**
5ï¸âƒ£ **åˆ›å»ºè®¾å¤‡æ–‡ä»¶**

**ç®€åŒ–ç¤ºä¾‹**ï¼š
```c
// ç¬¬1æ­¥ï¼šå®šä¹‰æ“ä½œå‡½æ•°
static int my_open(struct inode *inode, struct file *file) {
    printk("è®¾å¤‡è¢«æ‰“å¼€\n");
    return 0;
}

static ssize_t my_read(struct file *file, char __user *buffer, 
                       size_t count, loff_t *pos) {
    // å®ç°æ•°æ®è¯»å–é€»è¾‘
    return count;
}

// ç¬¬2æ­¥ï¼šå¡«å……æ“ä½œç»“æ„
static struct file_operations my_fops = {
    .owner = THIS_MODULE,
    .open = my_open,
    .read = my_read,
    .release = my_release,
};

// ç¬¬3æ­¥ï¼šæ³¨å†Œè®¾å¤‡
static int __init my_init(void) {
    major = register_chrdev(0, "mydev", &my_fops);  // 0è¡¨ç¤ºåŠ¨æ€åˆ†é…ä¸»è®¾å¤‡å·
    return 0;
}
```

### 2.4 è®¾å¤‡å·æ¦‚å¿µ


**è®¾å¤‡å·ç»„æˆ**ï¼š
- ğŸ”¸ **ä¸»è®¾å¤‡å· (major)**ï¼šæ ‡è¯†è®¾å¤‡ç±»å‹ï¼ŒåŒç±»è®¾å¤‡å…±äº«
- ğŸ”¸ **æ¬¡è®¾å¤‡å· (minor)**ï¼šåŒºåˆ†åŒç±»å‹çš„ä¸åŒè®¾å¤‡

```
ä¾‹å­ï¼š
/dev/ttyS0  â†’  ä¸»è®¾å¤‡å·4ï¼Œæ¬¡è®¾å¤‡å·64 (ç¬¬ä¸€ä¸ªä¸²å£)
/dev/ttyS1  â†’  ä¸»è®¾å¤‡å·4ï¼Œæ¬¡è®¾å¤‡å·65 (ç¬¬äºŒä¸ªä¸²å£)
/dev/sda1   â†’  ä¸»è®¾å¤‡å·8ï¼Œæ¬¡è®¾å¤‡å·1  (ç¬¬ä¸€ä¸ªç¡¬ç›˜ç¬¬ä¸€ä¸ªåˆ†åŒº)
```

---

## 3. ğŸ’¾ å—è®¾å¤‡é©±åŠ¨æ¡†æ¶


### 3.1 å—è®¾å¤‡çš„ç‰¹ç‚¹


**ä»€ä¹ˆæ˜¯å—è®¾å¤‡**ï¼šä»¥å›ºå®šå¤§å°çš„æ•°æ®å—ä¸ºå•ä½è¿›è¡Œè¯»å†™çš„å­˜å‚¨è®¾å¤‡ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- ğŸ”¸ **éšæœºè®¿é—®**ï¼šå¯ä»¥è·³è·ƒå¼è®¿é—®ä»»æ„ä½ç½®çš„æ•°æ®
- ğŸ”¸ **å—ç¼“å­˜**ï¼šå†…æ ¸æä¾›ç¼“å­˜æœºåˆ¶æé«˜æ€§èƒ½
- ğŸ”¸ **è¯·æ±‚é˜Ÿåˆ—**ï¼šå¤šä¸ªIOè¯·æ±‚å¯ä»¥åˆå¹¶å’Œé‡æ’åº

### 3.2 å—è®¾å¤‡ä¸å­—ç¬¦è®¾å¤‡çš„åŒºåˆ«


| ç‰¹æ€§ | **å­—ç¬¦è®¾å¤‡** | **å—è®¾å¤‡** |
|------|-------------|-----------|
| ğŸ“– **è®¿é—®æ–¹å¼** | `é¡ºåºè®¿é—®ï¼Œåƒè¯»ä¹¦` | `éšæœºè®¿é—®ï¼ŒåƒæŸ¥å­—å…¸` |
| ğŸ’¾ **ç¼“å­˜æœºåˆ¶** | `æ— ç¼“å­˜ï¼Œç›´æ¥è®¿é—®` | `æœ‰ç¼“å­˜ï¼Œæé«˜æ•ˆç‡` |
| ğŸ“¦ **æ•°æ®å•ä½** | `å­—èŠ‚æµ` | `æ•°æ®å—(é€šå¸¸512å­—èŠ‚æˆ–4KB)` |
| âš¡ **æ€§èƒ½ä¼˜åŒ–** | `ç®€å•ç›´æ¥` | `è¯·æ±‚åˆå¹¶ã€ç”µæ¢¯ç®—æ³•` |

### 3.3 å—è®¾å¤‡é©±åŠ¨æ ¸å¿ƒç»„ä»¶


**ä¸»è¦ç»“æ„**ï¼š

```
å—è®¾å¤‡é©±åŠ¨ = å—è®¾å¤‡ç»“æ„ + è¯·æ±‚é˜Ÿåˆ— + è¯·æ±‚å¤„ç†å‡½æ•°

block_deviceï¼š   è®¾å¤‡æœ¬èº«
request_queueï¼š  IOè¯·æ±‚é˜Ÿåˆ—  
requestï¼š        å•ä¸ªIOè¯·æ±‚
bioï¼š           åŸºæœ¬IOå•å…ƒ
```

**å…³é”®æ•°æ®ç»“æ„**ï¼š
```c
struct gendisk {
    int major;                    // ä¸»è®¾å¤‡å·
    char disk_name[32];          // è®¾å¤‡åç§°
    struct block_device_operations *fops;  // æ“ä½œå‡½æ•°é›†
    struct request_queue *queue;  // è¯·æ±‚é˜Ÿåˆ—
    sector_t capacity;           // è®¾å¤‡å®¹é‡(æ‰‡åŒºæ•°)
};

struct block_device_operations {
    int (*open)(struct block_device *, fmode_t);
    void (*release)(struct gendisk *, fmode_t);
    int (*ioctl)(struct block_device *, fmode_t, unsigned, unsigned long);
};
```

### 3.4 å—è®¾å¤‡é©±åŠ¨å¼€å‘è¦ç‚¹


**å…³é”®æ­¥éª¤**ï¼š

1ï¸âƒ£ **åˆ†é… gendisk ç»“æ„**ï¼š`alloc_disk()`
2ï¸âƒ£ **åˆ›å»ºè¯·æ±‚é˜Ÿåˆ—**ï¼š`blk_init_queue()`  
3ï¸âƒ£ **è®¾ç½®è®¾å¤‡å‚æ•°**ï¼šå®¹é‡ã€æ‰‡åŒºå¤§å°ç­‰
4ï¸âƒ£ **æ³¨å†Œå—è®¾å¤‡**ï¼š`add_disk()`
5ï¸âƒ£ **å®ç°è¯·æ±‚å¤„ç†å‡½æ•°**

> ğŸ’¡ **é‡è¦æ¦‚å¿µ**  
> å—è®¾å¤‡é©±åŠ¨çš„æ ¸å¿ƒæ˜¯**è¯·æ±‚å¤„ç†å‡½æ•°**ï¼Œå®ƒè´Ÿè´£å¤„ç†æ¥è‡ªå†…æ ¸çš„IOè¯·æ±‚ï¼Œå°†é€»è¾‘å—å·è½¬æ¢ä¸ºå®é™…çš„ç¡¬ä»¶æ“ä½œã€‚

---

## 4. ğŸŒ ç½‘ç»œè®¾å¤‡é©±åŠ¨æ¡†æ¶


### 4.1 ç½‘ç»œè®¾å¤‡çš„ç‰¹æ®Šæ€§


**ä¸ºä»€ä¹ˆç½‘ç»œè®¾å¤‡ç‰¹æ®Š**ï¼š
- ğŸ”¸ **æ— è®¾å¤‡æ–‡ä»¶**ï¼šä¸åƒå­—ç¬¦/å—è®¾å¤‡æœ‰ `/dev/xxx` æ–‡ä»¶
- ğŸ”¸ **æ•°æ®åŒ…ä¼ è¾“**ï¼šå¤„ç†çš„æ˜¯ç½‘ç»œæ•°æ®åŒ…ï¼Œä¸æ˜¯å­—èŠ‚æµ
- ğŸ”¸ **åè®®æ ˆé›†æˆ**ï¼šä¸TCP/IPåè®®æ ˆç´§å¯†ç»“åˆ

### 4.2 ç½‘ç»œè®¾å¤‡é©±åŠ¨æ¶æ„


```
åº”ç”¨ç¨‹åº
    â†“ (å¥—æ¥å­—æ¥å£)
TCP/IPåè®®æ ˆ
    â†“ (ç½‘ç»œæ¥å£)
ç½‘ç»œè®¾å¤‡é©±åŠ¨
    â†“ (ç¡¬ä»¶æ¥å£)
ç½‘ç»œç¡¬ä»¶(ç½‘å¡)
```

**æ ¸å¿ƒæ•°æ®ç»“æ„** `net_device`ï¼š
```c
struct net_device {
    char name[IFNAMSIZ];              // æ¥å£åç§°(å¦‚eth0)
    unsigned char dev_addr[MAX_ADDR_LEN];  // MACåœ°å€
    
    // æ ¸å¿ƒæ“ä½œå‡½æ•°
    int (*ndo_open)(struct net_device *dev);           // æ‰“å¼€æ¥å£
    int (*ndo_stop)(struct net_device *dev);           // å…³é—­æ¥å£  
    int (*ndo_start_xmit)(struct sk_buff *, struct net_device *); // å‘é€æ•°æ®
    
    // ç»Ÿè®¡ä¿¡æ¯
    struct net_device_stats stats;    // ç½‘ç»œç»Ÿè®¡
};
```

### 4.3 ç½‘ç»œè®¾å¤‡é©±åŠ¨å…³é”®æ¦‚å¿µ


**sk_buff ç»“æ„**ï¼š
- ğŸ”¸ **ä½œç”¨**ï¼šLinuxç½‘ç»œå­ç³»ç»Ÿä¸­è¡¨ç¤ºç½‘ç»œæ•°æ®åŒ…çš„æ ¸å¿ƒç»“æ„
- ğŸ”¸ **å†…å®¹**ï¼šåŒ…å«æ•°æ®åŒ…å†…å®¹ã€åè®®ä¿¡æ¯ã€è·¯ç”±ä¿¡æ¯ç­‰
- ğŸ”¸ **ä¼ é€’**ï¼šåœ¨åè®®æ ˆå„å±‚ä¹‹é—´ä¼ é€’

**ä¸­æ–­å¤„ç†**ï¼š
```c
// å…¸å‹çš„ç½‘ç»œè®¾å¤‡ä¸­æ–­å¤„ç†æµç¨‹
static irqreturn_t network_interrupt(int irq, void *dev_id) {
    // 1. è¯»å–ç¡¬ä»¶çŠ¶æ€
    // 2. å¦‚æœæ˜¯æ¥æ”¶ä¸­æ–­ï¼Œè°ƒç”¨netif_rx()ä¸ŠæŠ¥æ•°æ®åŒ…
    // 3. å¦‚æœæ˜¯å‘é€å®Œæˆä¸­æ–­ï¼Œé‡Šæ”¾å‘é€ç¼“å†²åŒº
    return IRQ_HANDLED;
}
```

---

## 5. ğŸ—ï¸ å¹³å°è®¾å¤‡é©±åŠ¨æ¨¡å‹


### 5.1 ä»€ä¹ˆæ˜¯å¹³å°è®¾å¤‡é©±åŠ¨æ¨¡å‹


**é€šä¿—è§£é‡Š**ï¼šå°±åƒ"çº¢å¨˜"ä¸€æ ·ï¼ŒæŠŠ**è®¾å¤‡**å’Œ**é©±åŠ¨**è¿›è¡Œé…å¯¹ã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
- ğŸ”¸ **è®¾å¤‡æè¿°**ï¼šç¡¬ä»¶ä¿¡æ¯ä»å“ªé‡Œæ¥ï¼Ÿ
- ğŸ”¸ **é©±åŠ¨åŒ¹é…**ï¼šæ€ä¹ˆçŸ¥é“ç”¨å“ªä¸ªé©±åŠ¨ï¼Ÿ
- ğŸ”¸ **èµ„æºç®¡ç†**ï¼šå†…å­˜ã€ä¸­æ–­ã€æ—¶é’Ÿç­‰èµ„æºå¦‚ä½•åˆ†é…ï¼Ÿ

### 5.2 å¹³å°è®¾å¤‡é©±åŠ¨æ¨¡å‹æ¶æ„


```
è®¾å¤‡æ ‘/ACPI/å¹³å°æ•°æ®
         â†“
    å¹³å°è®¾å¤‡ (platform_device)
         â†“ (åŒ¹é…)
    å¹³å°é©±åŠ¨ (platform_driver)
         â†“ (ç»‘å®š)
      å…·ä½“ç¡¬ä»¶æ“ä½œ
```

**æ ¸å¿ƒç»„ä»¶**ï¼š

| ç»„ä»¶ | **ä½œç”¨** | **æ¯”å–»** |
|------|---------|----------|
| `platform_device` | **æè¿°ç¡¬ä»¶è®¾å¤‡** | `èº«ä»½è¯(è®°å½•è®¾å¤‡ä¿¡æ¯)` |
| `platform_driver` | **é©±åŠ¨ç¨‹åºä»£ç ** | `å¸æœº(çŸ¥é“æ€ä¹ˆæ“ä½œ)` |
| `platform_bus` | **æ€»çº¿æ§åˆ¶å™¨** | `çº¢å¨˜(è´Ÿè´£é…å¯¹)` |

### 5.3 è®¾å¤‡å’Œé©±åŠ¨çš„åŒ¹é…æœºåˆ¶


**åŒ¹é…æ–¹å¼**ï¼š

1ï¸âƒ£ **è®¾å¤‡æ ‘åŒ¹é…**ï¼šé€šè¿‡ `compatible` å±æ€§
2ï¸âƒ£ **è®¾å¤‡ååŒ¹é…**ï¼šé€šè¿‡ `name` å­—æ®µ
3ï¸âƒ£ **IDè¡¨åŒ¹é…**ï¼šé€šè¿‡ `id_table` æ•°ç»„

```c
// é©±åŠ¨ç«¯å®šä¹‰æ”¯æŒçš„è®¾å¤‡
static struct of_device_id my_match_table[] = {
    { .compatible = "vendor,my-device" },  // æ”¯æŒçš„è®¾å¤‡ç±»å‹
    { },
};

static struct platform_driver my_driver = {
    .driver = {
        .name = "my-driver",
        .of_match_table = my_match_table,  // åŒ¹é…è¡¨
    },
    .probe = my_probe,      // è®¾å¤‡å‘ç°æ—¶è°ƒç”¨
    .remove = my_remove,    // è®¾å¤‡ç§»é™¤æ—¶è°ƒç”¨
};
```

### 5.4 probe å’Œ remove å‡½æ•°


**probe å‡½æ•°**ï¼šè®¾å¤‡å’Œé©±åŠ¨åŒ¹é…æˆåŠŸåè°ƒç”¨
```c
static int my_probe(struct platform_device *pdev) {
    // 1. è·å–è®¾å¤‡èµ„æº(å†…å­˜ã€ä¸­æ–­ç­‰)
    // 2. åˆå§‹åŒ–ç¡¬ä»¶
    // 3. æ³¨å†Œå­—ç¬¦/å—/ç½‘ç»œè®¾å¤‡
    // 4. åˆ›å»ºè®¾å¤‡æ–‡ä»¶
    return 0;  // æˆåŠŸè¿”å›0
}
```

**remove å‡½æ•°**ï¼šè®¾å¤‡è¢«ç§»é™¤æ—¶è°ƒç”¨
```c
static int my_remove(struct platform_device *pdev) {
    // 1. åœæ­¢ç¡¬ä»¶å·¥ä½œ
    // 2. é‡Šæ”¾ç”³è¯·çš„èµ„æº
    // 3. æ³¨é”€è®¾å¤‡
    return 0;
}
```

---

## 6. ğŸ“‹ é©±åŠ¨ç¨‹åºæ³¨å†Œä¸æ³¨é”€


### 6.1 æ¨¡å—åˆå§‹åŒ–å’Œæ¸…ç†


**Linuxå†…æ ¸æ¨¡å—çš„ç”Ÿå‘½å‘¨æœŸ**ï¼š

```
æ¨¡å—åŠ è½½ â†’ åˆå§‹åŒ–å‡½æ•° â†’ æ­£å¸¸å·¥ä½œ â†’ æ¸…ç†å‡½æ•° â†’ æ¨¡å—å¸è½½
    â†“         â†“           â†“         â†“         â†“
insmod â†’ module_init â†’ è®¾å¤‡å·¥ä½œ â†’ module_exit â†’ rmmod
```

**åŸºæœ¬æ¡†æ¶**ï¼š
```c
#include <linux/module.h>
#include <linux/init.h>

// æ¨¡å—åˆå§‹åŒ–å‡½æ•°
static int __init my_driver_init(void) {
    printk("é©±åŠ¨æ¨¡å—åŠ è½½\n");
    
    // 1. ç”³è¯·è®¾å¤‡å·
    // 2. æ³¨å†Œè®¾å¤‡
    // 3. åˆ›å»ºè®¾å¤‡æ–‡ä»¶
    
    return 0;  // æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›è´Ÿæ•°
}

// æ¨¡å—æ¸…ç†å‡½æ•°  
static void __exit my_driver_exit(void) {
    printk("é©±åŠ¨æ¨¡å—å¸è½½\n");
    
    // 1. åˆ é™¤è®¾å¤‡æ–‡ä»¶
    // 2. æ³¨é”€è®¾å¤‡
    // 3. é‡Šæ”¾è®¾å¤‡å·
}

// æŒ‡å®šåˆå§‹åŒ–å’Œæ¸…ç†å‡½æ•°
module_init(my_driver_init);
module_exit(my_driver_exit);

// æ¨¡å—ä¿¡æ¯
MODULE_LICENSE("GPL");
MODULE_AUTHOR("Your Name");
MODULE_DESCRIPTION("My Driver Description");
```

### 6.2 è®¾å¤‡å·ç®¡ç†


**é™æ€åˆ†é… vs åŠ¨æ€åˆ†é…**ï¼š

| æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **ä½¿ç”¨åœºæ™¯** |
|------|---------|----------|-------------|
| **é™æ€åˆ†é…** | `è®¾å¤‡å·å›ºå®šï¼Œä¾¿äºç®¡ç†` | `å¯èƒ½å†²çª` | `è°ƒè¯•é˜¶æ®µ` |
| **åŠ¨æ€åˆ†é…** | `é¿å…å†²çªï¼Œç³»ç»Ÿæ¨è` | `è®¾å¤‡å·ä¸å›ºå®š` | `æ­£å¼äº§å“` |

```c
// åŠ¨æ€åˆ†é…è®¾å¤‡å·ï¼ˆæ¨èï¼‰
static int major;  // ä¸»è®¾å¤‡å·

static int __init my_init(void) {
    // æ³¨å†Œå­—ç¬¦è®¾å¤‡ï¼Œè‡ªåŠ¨åˆ†é…ä¸»è®¾å¤‡å·
    major = register_chrdev(0, "mydev", &my_fops);
    if (major < 0) {
        printk("æ³¨å†Œå¤±è´¥\n");
        return major;
    }
    printk("åˆ†é…çš„ä¸»è®¾å¤‡å·: %d\n", major);
    return 0;
}

static void __exit my_exit(void) {
    // æ³¨é”€å­—ç¬¦è®¾å¤‡
    unregister_chrdev(major, "mydev");
}
```

### 6.3 è®¾å¤‡æ–‡ä»¶åˆ›å»º


**æ‰‹åŠ¨åˆ›å»º vs è‡ªåŠ¨åˆ›å»º**ï¼š

```bash
# æ‰‹åŠ¨åˆ›å»ºè®¾å¤‡æ–‡ä»¶
mknod /dev/mydev c 250 0  # cè¡¨ç¤ºå­—ç¬¦è®¾å¤‡ï¼Œ250æ˜¯ä¸»è®¾å¤‡å·ï¼Œ0æ˜¯æ¬¡è®¾å¤‡å·

# æŸ¥çœ‹è®¾å¤‡æ–‡ä»¶
ls -l /dev/mydev
crw-rw-rw- 1 root root 250, 0 Sep 18 14:30 /dev/mydev
```

**è‡ªåŠ¨åˆ›å»º**ï¼ˆä½¿ç”¨udevï¼‰ï¼š
```c
#include <linux/device.h>

static struct class *my_class;
static struct device *my_device;

static int __init my_init(void) {
    // 1. æ³¨å†Œè®¾å¤‡
    major = register_chrdev(0, "mydev", &my_fops);
    
    // 2. åˆ›å»ºè®¾å¤‡ç±»
    my_class = class_create(THIS_MODULE, "mydev_class");
    
    // 3. åˆ›å»ºè®¾å¤‡æ–‡ä»¶ /dev/mydev
    my_device = device_create(my_class, NULL, MKDEV(major, 0), NULL, "mydev");
    
    return 0;
}

static void __exit my_exit(void) {
    device_destroy(my_class, MKDEV(major, 0));  // åˆ é™¤è®¾å¤‡æ–‡ä»¶
    class_destroy(my_class);                    // åˆ é™¤è®¾å¤‡ç±»
    unregister_chrdev(major, "mydev");          // æ³¨é”€è®¾å¤‡
}
```

---

## 7. ğŸ”§ æ–‡ä»¶æ“ä½œæ¥å£å®ç°


### 7.1 file_operations ç»“æ„è¯¦è§£


**æ ¸å¿ƒæ“ä½œå‡½æ•°**ï¼š

| å‡½æ•° | **ä½œç”¨** | **ç”¨æˆ·ç©ºé—´å¯¹åº”** |
|------|---------|-----------------|
| `open` | **æ‰“å¼€è®¾å¤‡** | `open()` |
| `release` | **å…³é—­è®¾å¤‡** | `close()` |
| `read` | **è¯»å–æ•°æ®** | `read()` |
| `write` | **å†™å…¥æ•°æ®** | `write()` |
| `unlocked_ioctl` | **æ§åˆ¶æ“ä½œ** | `ioctl()` |
| `llseek` | **å®šä½æ“ä½œ** | `lseek()` |

### 7.2 read å’Œ write å‡½æ•°å®ç°


**å‡½æ•°åŸå‹**ï¼š
```c
ssize_t (*read)(struct file *file, char __user *buffer, size_t count, loff_t *pos);
ssize_t (*write)(struct file *file, const char __user *buffer, size_t count, loff_t *pos);
```

**å‚æ•°è¯´æ˜**ï¼š
- ğŸ”¸ `file`ï¼šæ–‡ä»¶ç»“æ„æŒ‡é’ˆ
- ğŸ”¸ `buffer`ï¼šç”¨æˆ·ç©ºé—´ç¼“å†²åŒº
- ğŸ”¸ `count`ï¼šè¦è¯»/å†™çš„å­—èŠ‚æ•°
- ğŸ”¸ `pos`ï¼šæ–‡ä»¶ä½ç½®æŒ‡é’ˆ

**å®ç°ç¤ºä¾‹**ï¼š
```c
static char kernel_buffer[1024];  // å†…æ ¸ç¼“å†²åŒº

static ssize_t my_read(struct file *file, char __user *buffer, 
                       size_t count, loff_t *pos) {
    int bytes_to_read = min(count, strlen(kernel_buffer));
    
    // å°†æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´
    if (copy_to_user(buffer, kernel_buffer, bytes_to_read)) {
        return -EFAULT;  // å¤åˆ¶å¤±è´¥
    }
    
    return bytes_to_read;  // è¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°
}

static ssize_t my_write(struct file *file, const char __user *buffer,
                        size_t count, loff_t *pos) {
    int bytes_to_write = min(count, sizeof(kernel_buffer) - 1);
    
    // å°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´
    if (copy_from_user(kernel_buffer, buffer, bytes_to_write)) {
        return -EFAULT;
    }
    
    kernel_buffer[bytes_to_write] = '\0';  // å­—ç¬¦ä¸²ç»“æŸç¬¦
    return bytes_to_write;
}
```

### 7.3 ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´æ•°æ®ä¼ è¾“


**ä¸ºä»€ä¹ˆéœ€è¦ç‰¹æ®Šçš„å¤åˆ¶å‡½æ•°**ï¼š
- ğŸ”¸ **å†…å­˜ä¿æŠ¤**ï¼šç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´å†…å­˜éš”ç¦»
- ğŸ”¸ **å®‰å…¨æ£€æŸ¥**ï¼šé˜²æ­¢è®¿é—®æ— æ•ˆå†…å­˜åœ°å€
- ğŸ”¸ **é¡µé¢è°ƒåº¦**ï¼šç”¨æˆ·ç©ºé—´å†…å­˜å¯èƒ½è¢«äº¤æ¢åˆ°ç£ç›˜

**å…³é”®å‡½æ•°**ï¼š

| å‡½æ•° | **æ–¹å‘** | **è¿”å›å€¼** |
|------|---------|-----------|
| `copy_to_user()` | **å†…æ ¸ â†’ ç”¨æˆ·** | `æœªå¤åˆ¶çš„å­—èŠ‚æ•°` |
| `copy_from_user()` | **ç”¨æˆ· â†’ å†…æ ¸** | `æœªå¤åˆ¶çš„å­—èŠ‚æ•°` |
| `get_user()` | **ç”¨æˆ· â†’ å†…æ ¸** | `å•ä¸ªå˜é‡` |
| `put_user()` | **å†…æ ¸ â†’ ç”¨æˆ·** | `å•ä¸ªå˜é‡` |

### 7.4 ioctl æ¥å£å®ç°


**ioctl çš„ä½œç”¨**ï¼šæä¾›è®¾å¤‡ç‰¹å®šçš„æ§åˆ¶æ¥å£ï¼Œè¶…å‡ºæ ‡å‡†è¯»å†™æ“ä½œçš„åŠŸèƒ½ã€‚

**å‘½ä»¤ç¼–ç è§„èŒƒ**ï¼š
```c
#include <linux/ioctl.h>

// å®šä¹‰ioctlå‘½ä»¤
#define MY_IOC_MAGIC 'k'                    // é­”æ•°ï¼Œæ ‡è¯†è®¾å¤‡
#define MY_IOC_RESET    _IO(MY_IOC_MAGIC, 0)           // æ— å‚æ•°å‘½ä»¤
#define MY_IOC_SET_VAL  _IOW(MY_IOC_MAGIC, 1, int)     // å†™å…¥æ•´æ•°
#define MY_IOC_GET_VAL  _IOR(MY_IOC_MAGIC, 2, int)     // è¯»å–æ•´æ•°

static long my_ioctl(struct file *file, unsigned int cmd, unsigned long arg) {
    switch (cmd) {
    case MY_IOC_RESET:
        // é‡ç½®è®¾å¤‡
        printk("è®¾å¤‡é‡ç½®\n");
        break;
        
    case MY_IOC_SET_VAL:
        // è®¾ç½®å€¼
        if (copy_from_user(&device_value, (int __user *)arg, sizeof(int)))
            return -EFAULT;
        break;
        
    case MY_IOC_GET_VAL:
        // è·å–å€¼
        if (copy_to_user((int __user *)arg, &device_value, sizeof(int)))
            return -EFAULT;
        break;
        
    default:
        return -ENOTTY;  // ä¸æ”¯æŒçš„å‘½ä»¤
    }
    return 0;
}
```

---

## 8. ğŸ” é©±åŠ¨è°ƒè¯•æŠ€æœ¯


### 8.1 å†…æ ¸æ‰“å°è°ƒè¯•


**printk å‡½æ•°**ï¼šå†…æ ¸ç‰ˆæœ¬çš„ `printf`

**æ—¥å¿—çº§åˆ«**ï¼š
```c
#define KERN_EMERG   "0"  // ç´§æ€¥ï¼šç³»ç»Ÿæ— æ³•ä½¿ç”¨
#define KERN_ALERT   "1"  // è­¦å‘Šï¼šå¿…é¡»ç«‹å³é‡‡å–è¡ŒåŠ¨  
#define KERN_CRIT    "2"  // ä¸¥é‡ï¼šä¸¥é‡é”™è¯¯æ¡ä»¶
#define KERN_ERR     "3"  // é”™è¯¯ï¼šé”™è¯¯æ¡ä»¶
#define KERN_WARNING "4"  // è­¦å‘Šï¼šè­¦å‘Šæ¡ä»¶
#define KERN_NOTICE  "5"  // æ³¨æ„ï¼šæ­£å¸¸ä½†é‡è¦çš„æ¡ä»¶
#define KERN_INFO    "6"  // ä¿¡æ¯ï¼šä¸€èˆ¬ä¿¡æ¯
#define KERN_DEBUG   "7"  // è°ƒè¯•ï¼šè°ƒè¯•çº§åˆ«ä¿¡æ¯
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```c
printk(KERN_INFO "è®¾å¤‡åˆå§‹åŒ–æˆåŠŸ\n");
printk(KERN_ERR "è®¾å¤‡æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯ç : %d\n", error_code);

// ç°ä»£å†…æ ¸æ¨èä½¿ç”¨
pr_info("è®¾å¤‡åˆå§‹åŒ–æˆåŠŸ\n");
pr_err("è®¾å¤‡æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯ç : %d\n", error_code);
```

**æŸ¥çœ‹å†…æ ¸æ—¥å¿—**ï¼š
```bash
# æŸ¥çœ‹å†…æ ¸æ¶ˆæ¯
dmesg | tail -20

# å®æ—¶æŸ¥çœ‹å†…æ ¸æ—¥å¿—
tail -f /var/log/kern.log

# è®¾ç½®æ‰“å°çº§åˆ«
echo 8 > /proc/sys/kernel/printk
```

### 8.2 /proc å’Œ /sys æ¥å£è°ƒè¯•


**åˆ›å»º /proc æ¥å£**ï¼š
```c
#include <linux/proc_fs.h>
#include <linux/seq_file.h>

static struct proc_dir_entry *proc_entry;

// /proc æ–‡ä»¶è¯»å–å‡½æ•°
static int my_proc_show(struct seq_file *m, void *v) {
    seq_printf(m, "è®¾å¤‡çŠ¶æ€: %s\n", device_status ? "å¼€å¯" : "å…³é—­");
    seq_printf(m, "å¤„ç†çš„è¯·æ±‚æ•°: %lu\n", request_count);
    return 0;
}

static int my_proc_open(struct inode *inode, struct file *file) {
    return single_open(file, my_proc_show, NULL);
}

static const struct file_operations my_proc_fops = {
    .open    = my_proc_open,
    .read    = seq_read,
    .llseek  = seq_lseek,
    .release = single_release,
};

// æ¨¡å—åˆå§‹åŒ–æ—¶åˆ›å»º
static int __init my_init(void) {
    proc_entry = proc_create("mydriver", 0644, NULL, &my_proc_fops);
    return 0;
}

// æ¨¡å—é€€å‡ºæ—¶åˆ é™¤
static void __exit my_exit(void) {
    proc_remove(proc_entry);
}
```

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹é©±åŠ¨çŠ¶æ€
cat /proc/mydriver

# è¾“å‡ºç¤ºä¾‹ï¼š
# è®¾å¤‡çŠ¶æ€: å¼€å¯
# å¤„ç†çš„è¯·æ±‚æ•°: 1247
```

### 8.3 å†…æ ¸è°ƒè¯•å·¥å…·


**å¸¸ç”¨è°ƒè¯•å·¥å…·**ï¼š

| å·¥å…· | **ç”¨é€”** | **ä½¿ç”¨åœºæ™¯** |
|------|---------|-------------|
| **GDB + KGDB** | `æºç çº§è°ƒè¯•` | `å¤æ‚é€»è¾‘è°ƒè¯•` |
| **QEMU** | `è™šæ‹Ÿæœºè°ƒè¯•` | `å¼€å‘ç¯å¢ƒæµ‹è¯•` |
| **ftrace** | `å‡½æ•°è·Ÿè¸ª` | `æ€§èƒ½åˆ†æ` |
| **crash** | `å´©æºƒåˆ†æ` | `äº‹ååˆ†æ` |

**ä½¿ç”¨ ftrace è·Ÿè¸ª**ï¼š
```bash
# å¼€å¯å‡½æ•°è·Ÿè¸ª
echo function > /sys/kernel/debug/tracing/current_tracer

# è®¾ç½®è·Ÿè¸ªçš„å‡½æ•°
echo my_driver_read > /sys/kernel/debug/tracing/set_ftrace_filter

# å¼€å§‹è·Ÿè¸ª
echo 1 > /sys/kernel/debug/tracing/tracing_on

# æŸ¥çœ‹è·Ÿè¸ªç»“æœ
cat /sys/kernel/debug/tracing/trace
```

### 8.4 é”™è¯¯å¤„ç†å’Œèµ„æºæ¸…ç†


**å¸¸è§é”™è¯¯ç **ï¼š
```c
// å¸¸ç”¨é”™è¯¯è¿”å›å€¼
#define -EINVAL   // æ— æ•ˆå‚æ•°
#define -ENOMEM   // å†…å­˜ä¸è¶³  
#define -EBUSY    // è®¾å¤‡å¿™
#define -EFAULT   // å†…å­˜è®¿é—®é”™è¯¯
#define -ENOTTY   // ä¸æ”¯æŒçš„ioctlå‘½ä»¤
```

**èµ„æºæ¸…ç†åŸåˆ™**ï¼š
```c
static int __init my_init(void) {
    int ret;
    
    // ç”³è¯·èµ„æº1
    ret = alloc_resource1();
    if (ret < 0)
        goto err_resource1;
    
    // ç”³è¯·èµ„æº2  
    ret = alloc_resource2();
    if (ret < 0)
        goto err_resource2;
    
    // ç”³è¯·èµ„æº3
    ret = alloc_resource3();
    if (ret < 0)
        goto err_resource3;
    
    return 0;

// é”™è¯¯å¤„ç†ï¼šæŒ‰ç”³è¯·çš„é€†åºé‡Šæ”¾èµ„æº
err_resource3:
    free_resource2();
err_resource2:
    free_resource1();
err_resource1:
    return ret;
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é©±åŠ¨åˆ†ç±»ï¼šå­—ç¬¦è®¾å¤‡ã€å—è®¾å¤‡ã€ç½‘ç»œè®¾å¤‡çš„åŒºåˆ«å’Œç‰¹ç‚¹
ğŸ”¸ æ ¸å¿ƒç»“æ„ï¼šfile_operationsã€gendiskã€net_deviceç­‰å…³é”®æ•°æ®ç»“æ„  
ğŸ”¸ å¹³å°æ¨¡å‹ï¼šplatform_device/driverçš„åŒ¹é…å’Œç»‘å®šæœºåˆ¶
ğŸ”¸ æ³¨å†Œæµç¨‹ï¼šä»æ¨¡å—åŠ è½½åˆ°è®¾å¤‡å¯ç”¨çš„å®Œæ•´æµç¨‹
ğŸ”¸ æ¥å£å®ç°ï¼šreadã€writeã€ioctlç­‰æ–‡ä»¶æ“ä½œçš„æ­£ç¡®å®ç°
ğŸ”¸ è°ƒè¯•æ–¹æ³•ï¼šprintkã€procæ¥å£ã€å†…æ ¸è°ƒè¯•å·¥å…·çš„ä½¿ç”¨
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é©±åŠ¨å¼€å‘çš„æœ¬è´¨**
```
é©±åŠ¨ = ç¡¬ä»¶æŠ½è±¡ + ç»Ÿä¸€æ¥å£
ç›®æ ‡ï¼šè®©åº”ç”¨ç¨‹åºä¸ç”¨å…³å¿ƒç¡¬ä»¶ç»†èŠ‚ï¼Œç»Ÿä¸€ä½¿ç”¨æ ‡å‡†æ¥å£è®¿é—®è®¾å¤‡
```

**ğŸ”¹ å†…æ ¸ç©ºé—´ vs ç”¨æˆ·ç©ºé—´**
```
å®‰å…¨éš”ç¦»ï¼šä¸¤ä¸ªç©ºé—´å†…å­˜å®Œå…¨éš”ç¦»ï¼Œå¿…é¡»ä½¿ç”¨ä¸“ç”¨å‡½æ•°ä¼ è¾“æ•°æ®
æƒé™å·®åˆ«ï¼šå†…æ ¸ç©ºé—´å¯ä»¥è®¿é—®æ‰€æœ‰èµ„æºï¼Œç”¨æˆ·ç©ºé—´å—é™åˆ¶
é”™è¯¯å½±å“ï¼šå†…æ ¸ç©ºé—´é”™è¯¯å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·ç©ºé—´é”™è¯¯åªå½±å“è¿›ç¨‹
```

**ğŸ”¹ å¹³å°è®¾å¤‡é©±åŠ¨æ¨¡å‹çš„ä»·å€¼**
```
åˆ†ç¦»è®¾è®¡ï¼šè®¾å¤‡æè¿°å’Œé©±åŠ¨ä»£ç åˆ†ç¦»ï¼Œä¾¿äºç§»æ¤å’Œç»´æŠ¤
è‡ªåŠ¨åŒ¹é…ï¼šå†…æ ¸è‡ªåŠ¨å®Œæˆè®¾å¤‡å’Œé©±åŠ¨çš„åŒ¹é…ç»‘å®š
èµ„æºç®¡ç†ï¼šç»Ÿä¸€çš„èµ„æºç®¡ç†å’Œç”Ÿå‘½å‘¨æœŸæ§åˆ¶
```

### 9.3 å®é™…å¼€å‘å»ºè®®


**ğŸ”¹ å¼€å‘æµç¨‹å»ºè®®**
- ğŸ“ **å…ˆç†è§£ç¡¬ä»¶**ï¼šä»”ç»†é˜…è¯»ç¡¬ä»¶æ•°æ®æ‰‹å†Œ
- ğŸ”§ **é€‰æ‹©æ¡†æ¶**ï¼šæ ¹æ®è®¾å¤‡ç±»å‹é€‰æ‹©åˆé€‚çš„é©±åŠ¨æ¡†æ¶
- ğŸ§ª **å°æ­¥éªŒè¯**ï¼šä»æœ€ç®€å•çš„åŠŸèƒ½å¼€å§‹ï¼Œé€æ­¥å®Œå–„
- ğŸ” **å……åˆ†æµ‹è¯•**ï¼šè€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶

**ğŸ”¹ è°ƒè¯•æŠ€å·§**
- ğŸ“Š **å¤šç”¨printk**ï¼šåœ¨å…³é”®è·¯å¾„æ·»åŠ æ‰“å°ä¿¡æ¯
- ğŸ“ **å–„ç”¨/proc**ï¼šåˆ›å»ºè°ƒè¯•æ¥å£æŸ¥çœ‹å†…éƒ¨çŠ¶æ€
- âš ï¸ **æ³¨æ„é”™è¯¯å¤„ç†**ï¼šç¡®ä¿æ‰€æœ‰èµ„æºéƒ½èƒ½æ­£ç¡®é‡Šæ”¾
- ğŸ”„ **æ¨¡å—åŒ–æµ‹è¯•**ï¼šåˆ†æ¨¡å—éªŒè¯åŠŸèƒ½

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é©±åŠ¨å°±æ˜¯ç¡¬ä»¶ç¿»è¯‘å®˜ï¼ŒæŠ½è±¡æ¥å£æœ€é‡è¦
- å­—ç¬¦å—ç½‘ä¸‰å¤§ç±»ï¼Œå¹³å°æ¨¡å‹æ¥é…å¯¹
- æ³¨å†Œæ³¨é”€è¦é…å¥—ï¼Œèµ„æºç®¡ç†ä¸èƒ½å°‘
- ç”¨æˆ·å†…æ ¸è¦åˆ†æ¸…ï¼Œè°ƒè¯•æ‰‹æ®µè¦çµæ´»