---
title: 14ã€æ€§èƒ½åˆ†æžä¸Žä¼˜åŒ–å·¥å…·
---
## ðŸ“š ç›®å½•

1. [æ€§èƒ½åˆ†æžåŸºç¡€æ¦‚å¿µ](#1-æ€§èƒ½åˆ†æžåŸºç¡€æ¦‚å¿µ)
2. [CPUæ€§èƒ½åˆ†æžå·¥å…·](#2-CPUæ€§èƒ½åˆ†æžå·¥å…·)
3. [å†…å­˜ä½¿ç”¨åˆ†æžå·¥å…·](#3-å†…å­˜ä½¿ç”¨åˆ†æžå·¥å…·)
4. [I/Oæ€§èƒ½ç›‘æŽ§å·¥å…·](#4-IOæ€§èƒ½ç›‘æŽ§å·¥å…·)
5. [ç«ç„°å›¾ç”Ÿæˆä¸Žåˆ†æž](#5-ç«ç„°å›¾ç”Ÿæˆä¸Žåˆ†æž)
6. [åŸºå‡†æµ‹è¯•å·¥å…·](#6-åŸºå‡†æµ‹è¯•å·¥å…·)
7. [ä¼˜åŒ–ç­–ç•¥éªŒè¯](#7-ä¼˜åŒ–ç­–ç•¥éªŒè¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ æ€§èƒ½åˆ†æžåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ€§èƒ½åˆ†æž


**ç®€å•ç†è§£ï¼š**
æ€§èƒ½åˆ†æžå°±åƒç»™ä½ çš„Linuxç³»ç»Ÿåš"ä½“æ£€"ï¼Œæ‰¾å‡ºå“ªé‡Œè¿è¡Œæ…¢ã€å“ªé‡Œå ç”¨èµ„æºå¤šã€‚å°±åƒåŒ»ç”Ÿç”¨å¬è¯Šå™¨æ£€æŸ¥å¿ƒè·³ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨å„ç§å·¥å…·æ¥"å¬"ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µã€‚

**æ€§èƒ½åˆ†æžçš„æ ¸å¿ƒç›®æ ‡ï¼š**
```
å‘çŽ°é—®é¢˜ï¼šæ‰¾å‡ºç³»ç»Ÿè¿è¡Œç¼“æ…¢çš„æ ¹æœ¬åŽŸå› 
å®šä½ç“¶é¢ˆï¼šç¡®å®šæ˜¯CPUã€å†…å­˜ã€è¿˜æ˜¯ç£ç›˜æ‹–äº†åŽè…¿
é‡åŒ–å½±å“ï¼šç”¨æ•°æ®è¯´è¯ï¼Œè€Œä¸æ˜¯å‡­æ„Ÿè§‰
éªŒè¯æ”¹è¿›ï¼šä¼˜åŒ–åŽç¡®è®¤æ•ˆæžœæ˜¯å¦æ˜Žæ˜¾
```

### 1.2 æ€§èƒ½åˆ†æžçš„åŸºæœ¬æ€è·¯


**åˆ†æžæµç¨‹å›¾ï¼š**
```
ç”¨æˆ·åé¦ˆæ€§èƒ½é—®é¢˜
        â†“
è§‚å¯Ÿç³»ç»Ÿæ•´ä½“çŠ¶å†µï¼ˆtop/htopï¼‰
        â†“
ç¡®å®šé—®é¢˜ç±»åž‹ï¼ˆCPU/å†…å­˜/IOï¼‰
        â†“
ä½¿ç”¨ä¸“é—¨å·¥å…·æ·±å…¥åˆ†æž
        â†“
æ‰¾åˆ°å…·ä½“ç“¶é¢ˆç‚¹
        â†“
åˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ
        â†“
éªŒè¯ä¼˜åŒ–æ•ˆæžœ
```

### 1.3 æ€§èƒ½æŒ‡æ ‡çš„æ ¸å¿ƒåˆ†ç±»


| **æ€§èƒ½ç»´åº¦** | **å…³æ³¨æŒ‡æ ‡** | **å¸¸è§é—®é¢˜** | **åˆ†æžé‡ç‚¹** |
|-------------|-------------|-------------|-------------|
| ðŸ”¥ **CPUæ€§èƒ½** | ä½¿ç”¨çŽ‡ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ | è¿›ç¨‹å ç”¨è¿‡é«˜ | æ‰¾å‡ºCPUå¯†é›†åž‹ä»»åŠ¡ |
| ðŸ’¾ **å†…å­˜æ€§èƒ½** | ä½¿ç”¨é‡ã€ç¼“å­˜å‘½ä¸­çŽ‡ | å†…å­˜æ³„éœ²ã€ä¸è¶³ | å†…å­˜åˆ†é…å’Œå›žæ”¶ |
| ðŸ’¿ **ç£ç›˜I/O** | è¯»å†™é€Ÿåº¦ã€IOPS | ç£ç›˜ç“¶é¢ˆ | I/Oç­‰å¾…æ—¶é—´ |
| ðŸŒ **ç½‘ç»œI/O** | å¸¦å®½ã€å»¶è¿Ÿã€ä¸¢åŒ… | ç½‘ç»œæ‹¥å¡ž | ç½‘ç»œä¼ è¾“æ•ˆçŽ‡ |

---

## 2. ðŸ”¥ CPUæ€§èƒ½åˆ†æžå·¥å…·


### 2.1 topå‘½ä»¤ï¼šç³»ç»Ÿæ€§èƒ½æ¦‚è§ˆ


**åŸºæœ¬ç”¨æ³•ï¼š**
`top`å‘½ä»¤å°±åƒæ±½è½¦çš„ä»ªè¡¨ç›˜ï¼Œèƒ½å¿«é€Ÿçœ‹åˆ°ç³»ç»Ÿçš„æ•´ä½“è¿è¡ŒçŠ¶å†µã€‚

```bash
# åŸºæœ¬æŸ¥çœ‹
top

# å¸¸ç”¨å¿«æ·é”®
1    # æ˜¾ç¤ºæ¯ä¸ªCPUæ ¸å¿ƒçš„ä½¿ç”¨æƒ…å†µ
P    # æŒ‰CPUä½¿ç”¨çŽ‡æŽ’åº
M    # æŒ‰å†…å­˜ä½¿ç”¨çŽ‡æŽ’åº
q    # é€€å‡º
```

**topè¾“å‡ºè§£è¯»ï¼š**
```
topç•Œé¢è¯´æ˜Žï¼š
ç¬¬1è¡Œï¼šç³»ç»Ÿæ—¶é—´ã€è¿è¡Œæ—¶é•¿ã€ç”¨æˆ·æ•°ã€å¹³å‡è´Ÿè½½
ç¬¬2è¡Œï¼šä»»åŠ¡æ€»æ•°ã€è¿è¡Œä¸­ã€ç¡çœ ã€åœæ­¢ã€åƒµå°¸è¿›ç¨‹æ•°
ç¬¬3è¡Œï¼šCPUä½¿ç”¨çŽ‡ - us(ç”¨æˆ·)ã€sy(ç³»ç»Ÿ)ã€id(ç©ºé—²)ã€wa(ç­‰å¾…)
ç¬¬4-5è¡Œï¼šå†…å­˜å’Œäº¤æ¢åˆ†åŒºä½¿ç”¨æƒ…å†µ

é‡ç‚¹å…³æ³¨ï¼š
- load averageï¼š1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå¹³å‡è´Ÿè½½
- %CPUï¼šè¿›ç¨‹CPUå ç”¨çŽ‡
- %MEMï¼šè¿›ç¨‹å†…å­˜å ç”¨çŽ‡
```

### 2.2 htopï¼šå¢žå¼ºç‰ˆçš„top


**ä¸ºä»€ä¹ˆé€‰æ‹©htopï¼š**
å¦‚æžœè¯´`top`æ˜¯é»‘ç™½ç”µè§†ï¼Œé‚£`htop`å°±æ˜¯å½©è‰²ç”µè§†ï¼Œä¿¡æ¯æ›´ç›´è§‚ã€æ“ä½œæ›´å‹å¥½ã€‚

```bash
# å®‰è£…htop
sudo apt install htop    # Ubuntu/Debian
sudo yum install htop    # CentOS/RHEL

# è¿è¡Œhtop
htop
```

**htopçš„ä¼˜åŠ¿ç‰¹ç‚¹ï¼š**
```
âœ… å½©è‰²æ˜¾ç¤ºï¼Œä¸€ç›®äº†ç„¶
âœ… æ”¯æŒé¼ æ ‡æ“ä½œ
âœ… å¯ä»¥ç›´æŽ¥æ€æ­»è¿›ç¨‹
âœ… æ˜¾ç¤ºè¿›ç¨‹æ ‘çŠ¶ç»“æž„
âœ… æ”¯æŒæœç´¢å’Œè¿‡æ»¤
âœ… å¯ä»¥è¿½è¸ªç‰¹å®šè¿›ç¨‹
```

### 2.3 perfï¼šä¸“ä¸šçº§CPUåˆ†æž


**perfæ˜¯ä»€ä¹ˆï¼š**
`perf`æ˜¯Linuxå†…æ ¸æä¾›çš„ä¸“ä¸šæ€§èƒ½åˆ†æžå·¥å…·ï¼Œå°±åƒç»™CPUè£…äº†ä¸ª"æ˜¾å¾®é•œ"ï¼Œèƒ½çœ‹åˆ°éžå¸¸ç»†èŠ‚çš„æ€§èƒ½ä¿¡æ¯ã€‚

**åŸºæœ¬ä½¿ç”¨åœºæ™¯ï¼š**

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“æ€§èƒ½ç»Ÿè®¡
perf stat sleep 5

# é‡‡æ ·åˆ†æžCPUä½¿ç”¨æƒ…å†µï¼ˆ5ç§’ï¼‰
perf record -g sleep 5

# æŸ¥çœ‹é‡‡æ ·ç»“æžœ
perf report

# å®žæ—¶æŸ¥çœ‹æœ€æ¶ˆè€—CPUçš„å‡½æ•°
perf top
```

**perfè¾“å‡ºçš„æ ¸å¿ƒä¿¡æ¯ï¼š**
```
perf stat è¾“å‡ºè§£è¯»ï¼š
- instructionsï¼šæ‰§è¡Œçš„æŒ‡ä»¤æ•°
- cyclesï¼šCPUå‘¨æœŸæ•°
- cache-missesï¼šç¼“å­˜æœªå‘½ä¸­æ¬¡æ•°
- branch-missesï¼šåˆ†æ”¯é¢„æµ‹å¤±è´¥æ¬¡æ•°

è¿™äº›æ•°æ®å‘Šè¯‰ä½ ï¼š
ç¨‹åºæ˜¯å¦é«˜æ•ˆåˆ©ç”¨äº†CPU
æ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ
```

### 2.4 å®žé™…CPUåˆ†æžæ¡ˆä¾‹


**åœºæ™¯ï¼š**ç³»ç»Ÿå“åº”æ…¢ï¼Œéœ€è¦æ‰¾å‡ºåŽŸå› 

**åˆ†æžæ­¥éª¤ï¼š**

```bash
# ç¬¬1æ­¥ï¼šæŸ¥çœ‹æ•´ä½“CPUçŠ¶å†µ
htop
# è§‚å¯Ÿï¼šæ˜¯å¦æœ‰è¿›ç¨‹CPUä½¿ç”¨çŽ‡è¿‡é«˜

# ç¬¬2æ­¥ï¼šå¦‚æžœå‘çŽ°å¯ç–‘è¿›ç¨‹ï¼ˆæ¯”å¦‚PID 1234ï¼‰
# è¯¦ç»†åˆ†æžè¯¥è¿›ç¨‹
perf record -p 1234 sleep 10
perf report

# ç¬¬3æ­¥ï¼šæŸ¥çœ‹è¯¥è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨
strace -p 1234

# ç¬¬4æ­¥ï¼šå¦‚æžœæ˜¯è‡ªå·±çš„ç¨‹åºï¼ŒæŸ¥çœ‹çƒ­ç‚¹å‡½æ•°
perf record -g ./your_program
perf report --no-children
```

---

## 3. ðŸ’¾ å†…å­˜ä½¿ç”¨åˆ†æžå·¥å…·


### 3.1 freeå‘½ä»¤ï¼šå†…å­˜ä½¿ç”¨æ¦‚è§ˆ


**åŸºæœ¬å†…å­˜æŸ¥çœ‹ï¼š**
```bash
# ä»¥äººç±»å¯è¯»çš„æ ¼å¼æ˜¾ç¤ºå†…å­˜ä¿¡æ¯
free -h

# æ¯2ç§’åˆ·æ–°ä¸€æ¬¡
free -h -s 2
```

**freeè¾“å‡ºè§£è¯»ï¼š**
```
             total    used    free   shared  buff/cache   available
Mem:          8.0G    2.1G    1.2G     180M        4.7G        5.5G
Swap:         2.0G      0B    2.0G

é‡è¦æ¦‚å¿µè§£é‡Šï¼š
- totalï¼šæ€»å†…å­˜å¤§å°
- usedï¼šå·²ä½¿ç”¨å†…å­˜ï¼ˆä¸åŒ…æ‹¬ç¼“å­˜ï¼‰
- freeï¼šå®Œå…¨ç©ºé—²çš„å†…å­˜
- buff/cacheï¼šç¼“å­˜å’Œç¼“å†²åŒºï¼ˆå¯ä»¥é‡Šæ”¾ç»™åº”ç”¨ä½¿ç”¨ï¼‰
- availableï¼šåº”ç”¨ç¨‹åºå¯ç”¨çš„å†…å­˜ï¼ˆfree + å¯é‡Šæ”¾çš„ç¼“å­˜ï¼‰

è®°ä½ï¼šavailableæ‰æ˜¯çœŸæ­£å¯ç”¨çš„å†…å­˜ï¼
```

### 3.2 pså‘½ä»¤æŸ¥çœ‹è¿›ç¨‹å†…å­˜


**æŸ¥çœ‹è¿›ç¨‹å†…å­˜ä½¿ç”¨ï¼š**
```bash
# æŒ‰å†…å­˜ä½¿ç”¨çŽ‡æŽ’åºæ˜¾ç¤ºè¿›ç¨‹
ps aux --sort=-%mem | head -10

# æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„è¯¦ç»†å†…å­˜ä¿¡æ¯
ps -p 1234 -o pid,ppid,cmd,%mem,vsz,rss
```

**å†…å­˜æŒ‡æ ‡å«ä¹‰ï¼š**
```
VSZï¼ˆVirtual Set Sizeï¼‰ï¼šè™šæ‹Ÿå†…å­˜å¤§å°
- è¿›ç¨‹ç”³è¯·çš„æ‰€æœ‰å†…å­˜ç©ºé—´
- åŒ…æ‹¬å…±äº«åº“ã€è¿˜æ²¡å®žé™…ä½¿ç”¨çš„å†…å­˜

RSSï¼ˆResident Set Sizeï¼‰ï¼šç‰©ç†å†…å­˜å¤§å°
- è¿›ç¨‹å®žé™…å ç”¨çš„ç‰©ç†å†…å­˜
- è¿™æ˜¯çœŸæ­£"èŠ±é’±"çš„å†…å­˜

%MEMï¼šå ç”¨ç‰©ç†å†…å­˜çš„ç™¾åˆ†æ¯”
- RSS / æ€»ç‰©ç†å†…å­˜ Ã— 100%
```

### 3.3 pmapï¼šè¿›ç¨‹å†…å­˜æ˜ å°„


**è¯¦ç»†æŸ¥çœ‹è¿›ç¨‹å†…å­˜å¸ƒå±€ï¼š**
```bash
# æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜æ˜ å°„
pmap -d 1234

# æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯
pmap -x 1234
```

**pmapè¾“å‡ºç†è§£ï¼š**
```
pmapèƒ½å‘Šè¯‰ä½ ï¼š
- è¿›ç¨‹çš„å†…å­˜æ˜¯å¦‚ä½•åˆ†å¸ƒçš„
- å“ªäº›æ˜¯ä»£ç æ®µã€æ•°æ®æ®µã€å †ã€æ ˆ
- å…±äº«åº“å ç”¨äº†å¤šå°‘å†…å­˜
- æ˜¯å¦æœ‰å†…å­˜ç¢Žç‰‡é—®é¢˜
```

### 3.4 valgrindï¼šå†…å­˜æ³„éœ²æ£€æµ‹


**ä»€ä¹ˆæ˜¯å†…å­˜æ³„éœ²ï¼š**
å°±åƒæ°´é¾™å¤´æ²¡å…³ç´§ä¸€æ ·ï¼Œç¨‹åºç”³è¯·äº†å†…å­˜ä½†å¿˜è®°é‡Šæ”¾ï¼Œä¹…è€Œä¹…ä¹‹ç³»ç»Ÿå†…å­˜å°±ä¼šä¸å¤Ÿç”¨ã€‚

```bash
# å®‰è£…valgrind
sudo apt install valgrind

# æ£€æµ‹å†…å­˜æ³„éœ²
valgrind --leak-check=full ./your_program

# æ£€æµ‹å†…å­˜é”™è¯¯ï¼ˆå¦‚è¶Šç•Œè®¿é—®ï¼‰
valgrind --tool=memcheck ./your_program
```

**valgrindæŠ¥å‘Šè§£è¯»ï¼š**
```
å…³é”®ä¿¡æ¯ï¼š
- "definitely lost"ï¼šç¡®å®šçš„å†…å­˜æ³„éœ²
- "possibly lost"ï¼šå¯èƒ½çš„å†…å­˜æ³„éœ²  
- "still reachable"ï¼šç¨‹åºç»“æŸæ—¶ä»å¯è®¿é—®çš„å†…å­˜
- "invalid read/write"ï¼šéžæ³•å†…å­˜è®¿é—®

é‡ç‚¹å…³æ³¨ "definitely lost"ï¼Œè¿™æ˜¯çœŸæ­£çš„å†…å­˜æ³„éœ²
```

---

## 4. ðŸ’¿ I/Oæ€§èƒ½ç›‘æŽ§å·¥å…·


### 4.1 iostatï¼šI/Oç»Ÿè®¡ä¿¡æ¯


**åŸºæœ¬I/Oç›‘æŽ§ï¼š**
```bash
# å®‰è£…sysstatåŒ…ï¼ˆåŒ…å«iostatï¼‰
sudo apt install sysstat

# æ¯2ç§’æ˜¾ç¤ºä¸€æ¬¡I/Oç»Ÿè®¡
iostat -x 2

# åªæ˜¾ç¤ºç£ç›˜è®¾å¤‡
iostat -d 2
```

**iostatå…³é”®æŒ‡æ ‡è§£è¯»ï¼š**
```
Device: è®¾å¤‡åç§°ï¼ˆå¦‚sda, nvme0n1ï¼‰
r/sï¼šæ¯ç§’è¯»è¯·æ±‚æ•°
w/sï¼šæ¯ç§’å†™è¯·æ±‚æ•°
rkB/sï¼šæ¯ç§’è¯»å–çš„KBæ•°
wkB/sï¼šæ¯ç§’å†™å…¥çš„KBæ•°
%utilï¼šè®¾å¤‡åˆ©ç”¨çŽ‡ï¼ˆé‡è¦æŒ‡æ ‡ï¼ï¼‰

é‡è¦æç¤ºï¼š
- %utilæŽ¥è¿‘100%è¯´æ˜Žç£ç›˜å·²ç»å¾ˆå¿™
- awaitè¡¨ç¤ºå¹³å‡ç­‰å¾…æ—¶é—´ï¼Œè¶Šå°è¶Šå¥½
- svctmè¡¨ç¤ºæœåŠ¡æ—¶é—´ï¼Œåæ˜ ç£ç›˜æ€§èƒ½
```

### 4.2 iotopï¼šå®žæ—¶I/Oç›‘æŽ§


**å®žæ—¶æŸ¥çœ‹è¿›ç¨‹I/Oä½¿ç”¨ï¼š**
```bash
# å®‰è£…iotop
sudo apt install iotop

# è¿è¡Œiotopï¼ˆéœ€è¦rootæƒé™ï¼‰
sudo iotop

# åªæ˜¾ç¤ºæœ‰I/Oæ´»åŠ¨çš„è¿›ç¨‹
sudo iotop -o
```

**iotopä½¿ç”¨æŠ€å·§ï¼š**
```
iotopç•Œé¢è¯´æ˜Žï¼š
- TOTALï¼šæ€»çš„I/Oå¸¦å®½ä½¿ç”¨
- READ/WRITEï¼šè¯»å†™é€Ÿåº¦
- SWAPINï¼šäº¤æ¢åˆ†åŒºè¯»å…¥
- IOï¼šè¿›ç¨‹çš„I/Oä¼˜å…ˆçº§

å¿«æ·é”®ï¼š
oï¼šåªæ˜¾ç¤ºæœ‰I/Oçš„è¿›ç¨‹
aï¼šæ˜¾ç¤ºç´¯ç§¯I/Oè€Œä¸æ˜¯å½“å‰I/O
qï¼šé€€å‡º
```

### 4.3 lsofï¼šæŸ¥çœ‹æ–‡ä»¶ä½¿ç”¨æƒ…å†µ


**ä»€ä¹ˆæ˜¯lsofï¼š**
`lsof`ï¼ˆlist open filesï¼‰èƒ½å‘Šè¯‰ä½ å“ªäº›è¿›ç¨‹æ­£åœ¨ä½¿ç”¨å“ªäº›æ–‡ä»¶ï¼Œå¯¹äºŽæ‰¾I/Oç“¶é¢ˆå¾ˆæœ‰ç”¨ã€‚

```bash
# æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶
lsof -p 1234

# æŸ¥çœ‹æŸä¸ªæ–‡ä»¶è¢«å“ªäº›è¿›ç¨‹ä½¿ç”¨
lsof /var/log/syslog

# æŸ¥çœ‹ç½‘ç»œè¿žæŽ¥
lsof -i

# æŸ¥çœ‹æŸä¸ªç«¯å£çš„ä½¿ç”¨æƒ…å†µ
lsof -i :80
```

**å®žé™…åº”ç”¨åœºæ™¯ï¼š**
```
ðŸ” æŽ’æŸ¥é—®é¢˜æ—¶çš„ä½¿ç”¨ï¼š
- ç£ç›˜ç©ºé—´æ»¡äº†ï¼Œä½†ä¸çŸ¥é“å“ªä¸ªè¿›ç¨‹åœ¨å†™
- æ–‡ä»¶æ— æ³•åˆ é™¤ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è¿›ç¨‹åœ¨ä½¿ç”¨
- ç½‘ç»œè¿žæŽ¥å¼‚å¸¸ï¼ŒæŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ
- ç¨‹åºå´©æºƒï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ–‡ä»¶å¥æŸ„æ³„éœ²
```

---

## 5. ðŸ”¥ ç«ç„°å›¾ç”Ÿæˆä¸Žåˆ†æž


### 5.1 ä»€ä¹ˆæ˜¯ç«ç„°å›¾


**å½¢è±¡ç†è§£ï¼š**
ç«ç„°å›¾å°±åƒç»™ç¨‹åºæ‹Xå…‰ç‰‡ï¼Œèƒ½æ¸…æ¥šåœ°çœ‹åˆ°ç¨‹åºè¿è¡Œæ—¶é—´éƒ½èŠ±åœ¨å“ªé‡Œäº†ã€‚æ¨ªè½´è¡¨ç¤ºæ—¶é—´å æ¯”ï¼Œçºµè½´è¡¨ç¤ºè°ƒç”¨å±‚æ¬¡ï¼Œé¢œè‰²è¶Š"çƒ­"ï¼ˆçº¢è‰²ï¼‰çš„åœ°æ–¹å°±æ˜¯æ€§èƒ½ç“¶é¢ˆã€‚

**ç«ç„°å›¾çš„åŸºæœ¬ç»“æž„ï¼š**
```
ç«ç„°å›¾çš„"ç«ç„°"å½¢çŠ¶ï¼š
         main()          â† æœ€åº•å±‚ï¼Œç¨‹åºå…¥å£
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
 func_a()    func_b()    â† ç¬¬äºŒå±‚ï¼Œmainè°ƒç”¨çš„å‡½æ•°
â”Œâ”€â”€â”€â”´â”€â”€â”€â”      â”‚
loop()  calc() slow_func() â† ç¬¬ä¸‰å±‚ï¼Œå…·ä½“çš„å‡½æ•°è°ƒç”¨

å®½åº¦ = æ—¶é—´å æ¯”
é«˜åº¦ = è°ƒç”¨å±‚æ¬¡
é¢œè‰² = çƒ­åº¦ï¼ˆçº¢è‰²=çƒ­ç‚¹ï¼‰
```

### 5.2 ä½¿ç”¨perfç”Ÿæˆç«ç„°å›¾


**ç”Ÿæˆç«ç„°å›¾çš„æ­¥éª¤ï¼š**

```bash
# ç¬¬1æ­¥ï¼šä¸‹è½½ç«ç„°å›¾ç”Ÿæˆè„šæœ¬
git clone https://github.com/brendangregg/FlameGraph.git

# ç¬¬2æ­¥ï¼šé‡‡é›†æ€§èƒ½æ•°æ®ï¼ˆ10ç§’é‡‡æ ·ï¼‰
perf record -F 99 -g ./your_program

# ç¬¬3æ­¥ï¼šç”Ÿæˆç«ç„°å›¾æ•°æ®
perf script > perf.data.txt

# ç¬¬4æ­¥ï¼šè½¬æ¢ä¸ºç«ç„°å›¾æ ¼å¼
./FlameGraph/stackcollapse-perf.pl perf.data.txt > perf.folded

# ç¬¬5æ­¥ï¼šç”Ÿæˆç«ç„°å›¾ï¼ˆSVGæ ¼å¼ï¼‰
./FlameGraph/flamegraph.pl perf.folded > flame.svg
```

### 5.3 ç«ç„°å›¾åˆ†æžæŠ€å·§


**å¦‚ä½•è¯»æ‡‚ç«ç„°å›¾ï¼š**

```
åˆ†æžè¦ç‚¹ï¼š
1. æ‰¾æœ€å®½çš„éƒ¨åˆ† â†’ æ—¶é—´å æ¯”æœ€å¤§çš„å‡½æ•°
2. çœ‹é¢œè‰²æ·±æµ… â†’ çº¢è‰²åŒºåŸŸé€šå¸¸æ˜¯çƒ­ç‚¹
3. è§‚å¯Ÿè°ƒç”¨å±‚æ¬¡ â†’ æ·±å±‚åµŒå¥—å¯èƒ½æœ‰é—®é¢˜
4. å…³æ³¨å¹³é¡¶ â†’ è¯´æ˜Žè¯¥å‡½æ•°å†…éƒ¨æ²¡æœ‰å¤æ‚è°ƒç”¨

ä¼˜åŒ–ç­–ç•¥ï¼š
- å®½è€Œå¹³çš„åŒºåŸŸï¼šç›´æŽ¥ä¼˜åŒ–è¿™ä¸ªå‡½æ•°
- é«˜è€Œçª„çš„åŒºåŸŸï¼šå¯èƒ½æ˜¯é€’å½’æˆ–æ·±å±‚è°ƒç”¨
- å¤šä¸ªå°å³°ï¼šå¯èƒ½éœ€è¦å‡å°‘å‡½æ•°è°ƒç”¨æ¬¡æ•°
```

**å®žé™…ä¼˜åŒ–æ¡ˆä¾‹ï¼š**
```
å‘çŽ°é—®é¢˜ï¼šç«ç„°å›¾æ˜¾ç¤ºstring_copyå‡½æ•°å ç”¨30%æ—¶é—´
åˆ†æžåŽŸå› ï¼šé¢‘ç¹çš„å­—ç¬¦ä¸²å¤åˆ¶æ“ä½œ
ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨å­—ç¬¦ä¸²å¼•ç”¨è€Œä¸æ˜¯å¤åˆ¶
éªŒè¯æ•ˆæžœï¼šé‡æ–°ç”Ÿæˆç«ç„°å›¾ç¡®è®¤æ”¹è¿›
```

---

## 6. âš¡ åŸºå‡†æµ‹è¯•å·¥å…·


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦åŸºå‡†æµ‹è¯•


**åŸºå‡†æµ‹è¯•çš„ä½œç”¨ï¼š**
å°±åƒä¹°è½¦å‰è¦è¯•é©¾ä¸€æ ·ï¼ŒåŸºå‡†æµ‹è¯•è®©ä½ çŸ¥é“ç³»ç»Ÿçš„çœŸå®žæ€§èƒ½è¡¨çŽ°ï¼Œä¸æ˜¯é çŒœçš„ã€‚

```
åŸºå‡†æµ‹è¯•èƒ½å›žç­”çš„é—®é¢˜ï¼š
- æˆ‘çš„ç£ç›˜æ¯ç§’èƒ½è¯»å†™å¤šå°‘æ•°æ®ï¼Ÿ
- CPUçš„è®¡ç®—èƒ½åŠ›å¦‚ä½•ï¼Ÿ
- ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½å¦‚ä½•ï¼Ÿ
- æ•°æ®åº“æ¯ç§’èƒ½å¤„ç†å¤šå°‘æŸ¥è¯¢ï¼Ÿ
```

### 6.2 CPUåŸºå‡†æµ‹è¯•


**sysbench CPUæµ‹è¯•ï¼š**
```bash
# å®‰è£…sysbench
sudo apt install sysbench

# CPUè®¡ç®—æ€§èƒ½æµ‹è¯•ï¼ˆè¿è¡Œ60ç§’ï¼‰
sysbench cpu --time=60 run

# å¤šçº¿ç¨‹CPUæµ‹è¯•
sysbench cpu --threads=4 --time=60 run
```

**stress-ngåŽ‹åŠ›æµ‹è¯•ï¼š**
```bash
# å®‰è£…stress-ng
sudo apt install stress-ng

# CPUåŽ‹åŠ›æµ‹è¯•ï¼ˆ4ä¸ªCPUæ ¸å¿ƒï¼Œè¿è¡Œ60ç§’ï¼‰
stress-ng --cpu 4 --timeout 60s

# åŒæ—¶æµ‹è¯•CPUã€å†…å­˜ã€I/O
stress-ng --cpu 2 --vm 1 --hdd 1 --timeout 60s
```

### 6.3 ç£ç›˜I/OåŸºå‡†æµ‹è¯•


**ddå‘½ä»¤æµ‹è¯•ç£ç›˜æ€§èƒ½ï¼š**
```bash
# æµ‹è¯•å†™æ€§èƒ½ï¼ˆå†™å…¥1GBæ•°æ®ï¼‰
dd if=/dev/zero of=test.img bs=1M count=1024 oflag=sync

# æµ‹è¯•è¯»æ€§èƒ½
dd if=test.img of=/dev/null bs=1M

# æ¸…ç†æµ‹è¯•æ–‡ä»¶
rm test.img
```

**fioä¸“ä¸šç£ç›˜æµ‹è¯•ï¼š**
```bash
# å®‰è£…fio
sudo apt install fio

# éšæœºè¯»æµ‹è¯•
fio --name=random_read --ioengine=libaio --rw=randread --bs=4k --size=1G --numjobs=1 --runtime=60

# éšæœºå†™æµ‹è¯•
fio --name=random_write --ioengine=libaio --rw=randwrite --bs=4k --size=1G --numjobs=1 --runtime=60
```

### 6.4 å†…å­˜åŸºå‡†æµ‹è¯•


**sysbenchå†…å­˜æµ‹è¯•ï¼š**
```bash
# å†…å­˜æ€§èƒ½æµ‹è¯•
sysbench memory --memory-total-size=10G run

# æŒ‡å®šå†…å­˜è®¿é—®æ¨¡å¼
sysbench memory --memory-oper=write --memory-total-size=10G run
```

**mbwå†…å­˜å¸¦å®½æµ‹è¯•ï¼š**
```bash
# å®‰è£…mbw
sudo apt install mbw

# æµ‹è¯•å†…å­˜å¸¦å®½ï¼ˆæµ‹è¯•500MBï¼‰
mbw 500
```

---

## 7. ðŸŽ¯ ä¼˜åŒ–ç­–ç•¥éªŒè¯


### 7.1 å»ºç«‹æ€§èƒ½åŸºçº¿


**ä»€ä¹ˆæ˜¯æ€§èƒ½åŸºçº¿ï¼š**
å°±åƒç»™ç³»ç»Ÿæ‹ä¸ª"å¥åº·æ¡£æ¡ˆç…§ç‰‡"ï¼Œè®°å½•ä¼˜åŒ–å‰çš„å„é¡¹æŒ‡æ ‡ï¼Œè¿™æ ·ä¼˜åŒ–åŽæ‰èƒ½å¯¹æ¯”çœ‹å‡ºæ•ˆæžœã€‚

**å»ºç«‹åŸºçº¿çš„æ­¥éª¤ï¼š**
```bash
# åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬
cat > baseline_test.sh << EOF
#!/bin/bash
echo "=== ç³»ç»Ÿä¿¡æ¯ ===" > baseline.log
uname -a >> baseline.log
echo "" >> baseline.log

echo "=== CPUåŸºçº¿æµ‹è¯• ===" >> baseline.log
sysbench cpu --time=30 run >> baseline.log
echo "" >> baseline.log

echo "=== å†…å­˜åŸºçº¿æµ‹è¯• ===" >> baseline.log
sysbench memory --memory-total-size=1G run >> baseline.log
echo "" >> baseline.log

echo "=== ç£ç›˜åŸºçº¿æµ‹è¯• ===" >> baseline.log
dd if=/dev/zero of=test.img bs=1M count=100 oflag=sync 2>> baseline.log
rm test.img
EOF

chmod +x baseline_test.sh
./baseline_test.sh
```

### 7.2 A/Bæµ‹è¯•æ–¹æ³•


**ä¼˜åŒ–æ•ˆæžœéªŒè¯æµç¨‹ï¼š**
```
ä¼˜åŒ–å‰åŽå¯¹æ¯”éªŒè¯ï¼š
1. è®°å½•ä¼˜åŒ–å‰æ€§èƒ½æ•°æ®
2. å®žæ–½ä¼˜åŒ–æŽªæ–½
3. è¿è¡Œç›¸åŒçš„æµ‹è¯•
4. å¯¹æ¯”å‰åŽæ•°æ®
5. è®¡ç®—æ€§èƒ½æå‡ç™¾åˆ†æ¯”
```

**å®žé™…éªŒè¯æ¡ˆä¾‹ï¼š**
```bash
# ä¼˜åŒ–å‰ï¼šæµ‹è¯•ç¨‹åºè¿è¡Œæ—¶é—´
time ./your_program

# è®°å½•ç»“æžœï¼šreal 0m5.234s

# å®žæ–½ä¼˜åŒ–ï¼ˆæ¯”å¦‚ç®—æ³•æ”¹è¿›ï¼‰
# ... ä¿®æ”¹ä»£ç  ...

# ä¼˜åŒ–åŽï¼šå†æ¬¡æµ‹è¯•
time ./your_program

# è®°å½•ç»“æžœï¼šreal 0m3.157s
# æ€§èƒ½æå‡ï¼š(5.234-3.157)/5.234 = 39.7%
```

### 7.3 æŒç»­ç›‘æŽ§ç­–ç•¥


**è®¾ç½®æ€§èƒ½ç›‘æŽ§è„šæœ¬ï¼š**
```bash
# åˆ›å»ºå®šæœŸæ€§èƒ½æ£€æŸ¥è„šæœ¬
cat > monitor.sh << EOF
#!/bin/bash
DATE=\$(date +"%Y-%m-%d %H:%M:%S")
echo "[\$DATE] ç³»ç»Ÿæ€§èƒ½ç›‘æŽ§" >> performance.log

# CPUä½¿ç”¨çŽ‡
CPU_USAGE=\$(top -bn1 | grep "Cpu(s)" | awk '{print \$2}' | cut -d'%' -f1)
echo "CPUä½¿ç”¨çŽ‡: \$CPU_USAGE%" >> performance.log

# å†…å­˜ä½¿ç”¨çŽ‡  
MEM_USAGE=\$(free | grep Mem | awk '{printf "%.1f", \$3/\$2 * 100.0}')
echo "å†…å­˜ä½¿ç”¨çŽ‡: \$MEM_USAGE%" >> performance.log

# ç£ç›˜ä½¿ç”¨çŽ‡
DISK_USAGE=\$(df -h / | awk 'NR==2 {print \$5}')
echo "ç£ç›˜ä½¿ç”¨çŽ‡: \$DISK_USAGE" >> performance.log
echo "" >> performance.log
EOF

# è®¾ç½®æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
echo "0 * * * * /path/to/monitor.sh" | crontab -
```

### 7.4 æ€§èƒ½å›žå½’æ£€æµ‹


**ä»€ä¹ˆæ˜¯æ€§èƒ½å›žå½’ï¼š**
å°±åƒæ²»ç—…åŽåˆå¤å‘ä¸€æ ·ï¼Œç³»ç»Ÿä¼˜åŒ–åŽæ€§èƒ½åˆå˜å·®äº†ï¼Œéœ€è¦åŠæ—¶å‘çŽ°å’Œå¤„ç†ã€‚

**å›žå½’æ£€æµ‹æ–¹æ³•ï¼š**
```bash
# è®¾ç½®æ€§èƒ½é˜ˆå€¼æ£€æŸ¥
cat > regression_check.sh << EOF
#!/bin/bash
# è®¾ç½®æ€§èƒ½é˜ˆå€¼
CPU_THRESHOLD=80
MEM_THRESHOLD=90
DISK_THRESHOLD=85

# æ£€æŸ¥CPUä½¿ç”¨çŽ‡
CPU_CURRENT=\$(top -bn1 | grep "Cpu(s)" | awk '{print \$2}' | cut -d'%' -f1 | cut -d'.' -f1)
if [ \$CPU_CURRENT -gt \$CPU_THRESHOLD ]; then
    echo "è­¦å‘Šï¼šCPUä½¿ç”¨çŽ‡è¿‡é«˜ \$CPU_CURRENT%"
fi

# ç±»ä¼¼åœ°æ£€æŸ¥å†…å­˜å’Œç£ç›˜...
EOF
```

---

## 8. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒå·¥å…·


```
ðŸ”¸ ç³»ç»Ÿæ¦‚è§ˆå·¥å…·ï¼štop/htop - äº†è§£æ•´ä½“çŠ¶å†µ
ðŸ”¸ CPUåˆ†æžå·¥å…·ï¼šperf - æ·±å…¥åˆ†æžCPUæ€§èƒ½
ðŸ”¸ å†…å­˜åˆ†æžå·¥å…·ï¼šfree/ps/pmap - å†…å­˜ä½¿ç”¨æƒ…å†µ
ðŸ”¸ I/Oç›‘æŽ§å·¥å…·ï¼šiostat/iotop - ç£ç›˜æ€§èƒ½ç›‘æŽ§
ðŸ”¸ ç«ç„°å›¾å·¥å…·ï¼šperf + FlameGraph - å¯è§†åŒ–æ€§èƒ½ç“¶é¢ˆ
ðŸ”¸ åŸºå‡†æµ‹è¯•å·¥å…·ï¼šsysbench/fio - æ€§èƒ½æµ‹è¯•
```

### 8.2 æ€§èƒ½åˆ†æžçš„é»„é‡‘æ³•åˆ™


**ðŸ”¹ å…ˆæ•´ä½“åŽå±€éƒ¨ï¼š**
```
åˆ†æžé¡ºåºï¼š
1. å…ˆç”¨top/htopçœ‹æ•´ä½“æƒ…å†µ
2. ç¡®å®šç“¶é¢ˆç±»åž‹ï¼ˆCPU/å†…å­˜/I/Oï¼‰
3. å†ç”¨ä¸“é—¨å·¥å…·æ·±å…¥åˆ†æž
4. æœ€åŽå®šä½åˆ°å…·ä½“å‡½æ•°æˆ–è¿›ç¨‹
```

**ðŸ”¹ æ•°æ®é©±åŠ¨å†³ç­–ï¼š**
```
é¿å…çŒœæµ‹ï¼Œç”¨æ•°æ®è¯´è¯ï¼š
- å»ºç«‹æ€§èƒ½åŸºçº¿
- é‡åŒ–ä¼˜åŒ–æ•ˆæžœ
- æŒç»­ç›‘æŽ§å˜åŒ–
- åŠæ—¶å‘çŽ°å›žå½’
```

**ðŸ”¹ ä¼˜åŒ–çš„ä¼˜å…ˆçº§ï¼š**
```
ä¼˜åŒ–é¡ºåºï¼š
1. å…ˆä¼˜åŒ–ç®—æ³•ï¼ˆæœ€å¤§æ”¶ç›Šï¼‰
2. å†ä¼˜åŒ–I/Oï¼ˆé€šå¸¸æ˜¯ç“¶é¢ˆï¼‰
3. ç„¶åŽä¼˜åŒ–å†…å­˜ä½¿ç”¨
4. æœ€åŽè€ƒè™‘ç¡¬ä»¶å‡çº§
```

### 8.3 å®žé™…åº”ç”¨æŒ‡å¯¼


**ðŸŽ¯ æ—¥å¸¸è¿ç»´åœºæ™¯ï¼š**
- **æœåŠ¡å™¨å“åº”æ…¢**ï¼šhtopçœ‹CPUï¼Œiostatçœ‹I/O
- **å†…å­˜ä¸è¶³**ï¼šfreeæŸ¥çœ‹å¯ç”¨å†…å­˜ï¼Œpsæ‰¾å†…å­˜å¤§æˆ·
- **ç¨‹åºæ€§èƒ½å·®**ï¼šperfåˆ†æžçƒ­ç‚¹å‡½æ•°ï¼Œç«ç„°å›¾å¯è§†åŒ–
- **ç³»ç»Ÿå¡é¡¿**ï¼štopçœ‹è´Ÿè½½ï¼Œiotopçœ‹I/Oç­‰å¾…

**ðŸ”§ å¼€å‘è°ƒè¯•åœºæ™¯ï¼š**
- **ç¨‹åºè¿è¡Œæ…¢**ï¼šç«ç„°å›¾æ‰¾æ€§èƒ½ç“¶é¢ˆ
- **å†…å­˜æ³„éœ²**ï¼švalgrindæ£€æµ‹å†…å­˜é—®é¢˜
- **åŸºå‡†å¯¹æ¯”**ï¼šsysbenchå»ºç«‹æ€§èƒ½åŸºçº¿
- **ä¼˜åŒ–éªŒè¯**ï¼šA/Bæµ‹è¯•ç¡®è®¤æ”¹è¿›æ•ˆæžœ

**âš ï¸ å¸¸è§è¯¯åŒºé¿å…ï¼š**
```
âŒ åªçœ‹CPUä½¿ç”¨çŽ‡ï¼Œå¿½ç•¥I/Oç­‰å¾…
âŒ æ²¡æœ‰å»ºç«‹åŸºçº¿å°±å¼€å§‹ä¼˜åŒ–
âŒ è¿‡åº¦ä¼˜åŒ–ä¸é‡è¦çš„éƒ¨åˆ†
âŒ ä¼˜åŒ–åŽä¸éªŒè¯æ•ˆæžœ
```

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
- æ€§èƒ½åˆ†æžåˆ†å±‚æ¬¡ï¼Œæ•´ä½“å±€éƒ¨è¦åˆ†æ¸…
- å·¥å…·é€‰æ‹©çœ‹åœºæ™¯ï¼Œæ•°æ®è¯´è¯æœ€å¯ä¿¡
- åŸºçº¿å¯¹æ¯”éªŒæ•ˆæžœï¼ŒæŒç»­ç›‘æŽ§é˜²å›žå½’
- ä¼˜åŒ–é¡ºåºæœ‰è½»é‡ï¼Œç®—æ³•I/Oæ˜¯é‡ç‚¹