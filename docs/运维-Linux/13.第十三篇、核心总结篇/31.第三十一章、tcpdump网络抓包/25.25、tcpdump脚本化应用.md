---
title: 25ã€tcpdumpè„šæœ¬åŒ–åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [shellè„šæœ¬é›†æˆåŸºç¡€](#1-shellè„šæœ¬é›†æˆåŸºç¡€)
2. [è‡ªåŠ¨åŒ–æŠ“åŒ…è„šæœ¬è®¾è®¡](#2-è‡ªåŠ¨åŒ–æŠ“åŒ…è„šæœ¬è®¾è®¡)
3. [å®šæ—¶ä»»åŠ¡é…ç½®ä¸ç®¡ç†](#3-å®šæ—¶ä»»åŠ¡é…ç½®ä¸ç®¡ç†)
4. [æ¡ä»¶è§¦å‘æœºåˆ¶å®ç°](#4-æ¡ä»¶è§¦å‘æœºåˆ¶å®ç°)
5. [ç»“æœå¤„ç†ç®¡é“è®¾è®¡](#5-ç»“æœå¤„ç†ç®¡é“è®¾è®¡)
6. [æ—¥å¿—è®°å½•ä¸ç®¡ç†](#6-æ—¥å¿—è®°å½•ä¸ç®¡ç†)
7. [é”™è¯¯å¤„ç†æœºåˆ¶](#7-é”™è¯¯å¤„ç†æœºåˆ¶)
8. [è„šæœ¬æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#8-è„šæœ¬æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš shellè„šæœ¬é›†æˆåŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯tcpdumpè„šæœ¬åŒ–


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
tcpdumpè„šæœ¬åŒ–ï¼šå°†tcpdumpå‘½ä»¤é›†æˆåˆ°shellè„šæœ¬ä¸­
ç›®çš„ï¼šå®ç°è‡ªåŠ¨åŒ–ç½‘ç»œç›‘æ§ã€æ•…éšœè¯Šæ–­ã€å®‰å…¨åˆ†æ
æœ¬è´¨ï¼šé€šè¿‡è„šæœ¬æ§åˆ¶tcpdumpçš„æ‰§è¡Œã€è¾“å‡ºå¤„ç†ã€ç»“æœåˆ†æ
```

> ğŸ’¡ **ç®€å•ç†è§£**ï¼šå°±åƒç»™tcpdumpè£…ä¸Šäº†"å¤§è„‘"ï¼Œè®©å®ƒèƒ½æŒ‰ç…§æˆ‘ä»¬çš„æƒ³æ³•è‡ªåŠ¨å·¥ä½œï¼Œè€Œä¸éœ€è¦äººå·¥ä¸€ç›´ç›‘æ§

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
```
ä¼ ç»Ÿæ‰‹å·¥æŠ“åŒ…ï¼šå°±åƒç«™åœ¨è·¯å£æ‰‹å·¥è®°å½•æ¯è¾†è½¦çš„ä¿¡æ¯
è„šæœ¬åŒ–æŠ“åŒ…ï¼šå°±åƒå®‰è£…äº†æ™ºèƒ½ç›‘æ§ç³»ç»Ÿï¼Œè‡ªåŠ¨è¯†åˆ«ã€è®°å½•ã€åˆ†æ
```

### 1.2 è„šæœ¬åŒ–çš„æ ¸å¿ƒä¼˜åŠ¿


**ğŸ“Š å¯¹æ¯”åˆ†æ**

| æ–¹å¼ | **æ‰‹å·¥æ‰§è¡Œ** | **è„šæœ¬åŒ–æ‰§è¡Œ** |
|------|-------------|---------------|
| **ç›‘æ§è¿ç»­æ€§** | ğŸ”´ éœ€è¦äººå·¥å€¼å®ˆ | ğŸŸ¢ 24/7è‡ªåŠ¨ç›‘æ§ |
| **æ•°æ®å¤„ç†** | ğŸŸ¡ æ‰‹å·¥åˆ†æ | ğŸŸ¢ è‡ªåŠ¨åˆ†æå¤„ç† |
| **å“åº”é€Ÿåº¦** | ğŸ”´ ä¾èµ–äººå·¥ååº” | ğŸŸ¢ ç§’çº§è‡ªåŠ¨å“åº” |
| **å‡†ç¡®æ€§** | ğŸŸ¡ å®¹æ˜“å‡ºé”™ | ğŸŸ¢ é€»è¾‘å‡†ç¡® |
| **å¯é‡ç°æ€§** | ğŸ”´ éš¾ä»¥é‡ç° | ğŸŸ¢ å®Œå…¨å¯é‡ç° |

### 1.3 åŸºæœ¬è„šæœ¬ç»“æ„


**ğŸ”§ æ ‡å‡†è„šæœ¬æ¨¡æ¿**
```bash
#!/bin/bash
# tcpdumpè‡ªåŠ¨åŒ–è„šæœ¬åŸºç¡€æ¨¡æ¿

# ============ é…ç½®å‚æ•° ============
INTERFACE="eth0"                    # ç½‘ç»œæ¥å£
CAPTURE_FILE="/tmp/capture.pcap"    # è¾“å‡ºæ–‡ä»¶
LOG_FILE="/var/log/tcpdump.log"     # æ—¥å¿—æ–‡ä»¶

# ============ å‡½æ•°å®šä¹‰ ============
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# ============ ä¸»æ‰§è¡Œé€»è¾‘ ============
main() {
    log_message "å¼€å§‹ç½‘ç»œæŠ“åŒ…..."
    # å…·ä½“çš„tcpdumpæ‰§è¡Œé€»è¾‘
}

# ============ è„šæœ¬å…¥å£ ============
main "$@"
```

**ğŸ¯ å…³é”®è¦ç´ è§£é‡Š**
- **é…ç½®å‚æ•°**ï¼šå°†å¯å˜çš„å‚æ•°é›†ä¸­ç®¡ç†ï¼Œä¾¿äºä¿®æ”¹
- **å‡½æ•°å®šä¹‰**ï¼šå°†å¤ç”¨é€»è¾‘å°è£…æˆå‡½æ•°ï¼Œæé«˜ä»£ç å¤ç”¨æ€§
- **æ—¥å¿—è®°å½•**ï¼šè®°å½•è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§
- **ä¸»å‡½æ•°**ï¼šæ ¸å¿ƒæ‰§è¡Œé€»è¾‘ï¼Œä¿æŒè„šæœ¬ç»“æ„æ¸…æ™°

---

## 2. ğŸ¤– è‡ªåŠ¨åŒ–æŠ“åŒ…è„šæœ¬è®¾è®¡


### 2.1 åŸºç¡€è‡ªåŠ¨åŒ–è„šæœ¬


**ğŸ“ ç®€å•æŠ“åŒ…è„šæœ¬**
```bash
#!/bin/bash
# åŸºç¡€è‡ªåŠ¨åŒ–æŠ“åŒ…è„šæœ¬

INTERFACE=${1:-eth0}
DURATION=${2:-60}
OUTPUT_DIR="/var/captures"

# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir -p "$OUTPUT_DIR"

# ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶å
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
CAPTURE_FILE="$OUTPUT_DIR/capture_${TIMESTAMP}.pcap"

echo "å¼€å§‹æŠ“åŒ…ï¼šæ¥å£=$INTERFACE, æ—¶é•¿=${DURATION}ç§’"
echo "è¾“å‡ºæ–‡ä»¶ï¼š$CAPTURE_FILE"

# æ‰§è¡ŒæŠ“åŒ…
tcpdump -i "$INTERFACE" -w "$CAPTURE_FILE" -G "$DURATION" -W 1

echo "æŠ“åŒ…å®Œæˆï¼Œæ–‡ä»¶ä¿å­˜è‡³ï¼š$CAPTURE_FILE"
```

### 2.2 é«˜çº§æŠ“åŒ…è„šæœ¬è®¾è®¡


**ğŸ¯ åŠŸèƒ½å®Œæ•´çš„æŠ“åŒ…è„šæœ¬**
```bash
#!/bin/bash
# é«˜çº§è‡ªåŠ¨åŒ–æŠ“åŒ…è„šæœ¬

# ============ é…ç½®åŒºåŸŸ ============
SCRIPT_NAME="advanced_capture"
CONFIG_FILE="/etc/tcpdump/capture.conf"
DEFAULT_INTERFACE="eth0"
DEFAULT_DURATION="300"
DEFAULT_MAX_SIZE="100M"

# ============ åŠ è½½é…ç½®æ–‡ä»¶ ============
load_config() {
    if [[ -f "$CONFIG_FILE" ]]; then
        source "$CONFIG_FILE"
    fi
    
    INTERFACE=${INTERFACE:-$DEFAULT_INTERFACE}
    DURATION=${DURATION:-$DEFAULT_DURATION}
    MAX_SIZE=${MAX_SIZE:-$DEFAULT_MAX_SIZE}
}

# ============ å‚æ•°éªŒè¯ ============
validate_parameters() {
    # æ£€æŸ¥æ¥å£æ˜¯å¦å­˜åœ¨
    if ! ip link show "$INTERFACE" >/dev/null 2>&1; then
        echo "é”™è¯¯ï¼šç½‘ç»œæ¥å£ $INTERFACE ä¸å­˜åœ¨"
        exit 1
    fi
    
    # æ£€æŸ¥æƒé™
    if [[ $EUID -ne 0 ]]; then
        echo "é”™è¯¯ï¼šéœ€è¦rootæƒé™æ‰§è¡Œç½‘ç»œæŠ“åŒ…"
        exit 1
    fi
}

# ============ æ‰§è¡ŒæŠ“åŒ… ============
execute_capture() {
    local filter="$1"
    local output_file="$2"
    
    echo "æŠ“åŒ…å‚æ•°ï¼š"
    echo "  æ¥å£ï¼š$INTERFACE"
    echo "  è¿‡æ»¤å™¨ï¼š${filter:-'æ— '}"
    echo "  æ—¶é•¿ï¼š${DURATION}ç§’"
    echo "  æ–‡ä»¶ï¼š$output_file"
    
    if [[ -n "$filter" ]]; then
        tcpdump -i "$INTERFACE" -w "$output_file" \
                -G "$DURATION" -W 1 -C "$MAX_SIZE" "$filter"
    else
        tcpdump -i "$INTERFACE" -w "$output_file" \
                -G "$DURATION" -W 1 -C "$MAX_SIZE"
    fi
}

# ============ ä¸»å‡½æ•° ============
main() {
    load_config
    validate_parameters
    
    local filter="$1"
    local timestamp=$(date +"%Y%m%d_%H%M%S")
    local output_file="/var/captures/capture_${timestamp}.pcap"
    
    execute_capture "$filter" "$output_file"
}

main "$@"
```

### 2.3 ä¸“ç”¨åœºæ™¯è„šæœ¬


**ğŸ” HTTPæµé‡ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# HTTPæµé‡ä¸“ç”¨ç›‘æ§è„šæœ¬

monitor_http_traffic() {
    local interface="$1"
    local log_file="/var/log/http_monitor.log"
    
    echo "å¼€å§‹ç›‘æ§HTTPæµé‡..."
    
    tcpdump -i "$interface" -A -s 0 'tcp port 80 or tcp port 443' | \
    while read line; do
        if echo "$line" | grep -q "GET\|POST\|PUT\|DELETE"; then
            echo "[$(date)] HTTPè¯·æ±‚: $line" >> "$log_file"
        fi
    done
}

# è°ƒç”¨å‡½æ•°
monitor_http_traffic "eth0"
```

---

## 3. â° å®šæ—¶ä»»åŠ¡é…ç½®ä¸ç®¡ç†


### 3.1 crontabåŸºç¡€åº”ç”¨


**ğŸ“… ä»€ä¹ˆæ˜¯å®šæ—¶ä»»åŠ¡**
```
å®šæ—¶ä»»åŠ¡ï¼šè®©ç³»ç»Ÿåœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ‰§è¡ŒæŒ‡å®šå‘½ä»¤
ä½œç”¨ï¼šå®ç°æ— äººå€¼å®ˆçš„ç½‘ç»œç›‘æ§
å¸¸ç”¨å·¥å…·ï¼šcrontabï¼ˆæœ€å¸¸ç”¨ï¼‰ã€systemd timer
```

**ğŸ• crontabæ—¶é—´æ ¼å¼è§£è¯»**
```
æ ¼å¼ï¼šåˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ å‘½ä»¤
ç¤ºä¾‹ï¼š0 2 * * * /path/to/script.sh

æ—¶é—´å­—æ®µè¯´æ˜ï¼š
â”Œâ”€åˆ†é’Ÿ (0-59)
â”‚ â”Œâ”€å°æ—¶ (0-23)  
â”‚ â”‚ â”Œâ”€æ—¥æœŸ (1-31)
â”‚ â”‚ â”‚ â”Œâ”€æœˆä»½ (1-12)
â”‚ â”‚ â”‚ â”‚ â”Œâ”€æ˜ŸæœŸ (0-7, 0å’Œ7éƒ½è¡¨ç¤ºå‘¨æ—¥)
â”‚ â”‚ â”‚ â”‚ â”‚
* * * * * å‘½ä»¤
```

### 3.2 å¸¸ç”¨å®šæ—¶ä»»åŠ¡é…ç½®


**ğŸ“‹ å®ç”¨å®šæ—¶ä»»åŠ¡ç¤ºä¾‹**

| **ç›‘æ§éœ€æ±‚** | **crontabé…ç½®** | **è¯´æ˜** |
|-------------|-----------------|----------|
| **æ¯å°æ—¶æŠ“åŒ…** | `0 * * * * /usr/local/bin/capture.sh` | æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œ |
| **æ¯æ—¥å‡Œæ™¨2ç‚¹** | `0 2 * * * /usr/local/bin/daily_capture.sh` | é¿å¼€ä¸šåŠ¡é«˜å³°æœŸ |
| **æ¯5åˆ†é’Ÿæ£€æŸ¥** | `*/5 * * * * /usr/local/bin/check_network.sh` | é«˜é¢‘ç›‘æ§ |
| **å·¥ä½œæ—¥ç›‘æ§** | `0 9 * * 1-5 /usr/local/bin/workday_monitor.sh` | åªåœ¨å·¥ä½œæ—¥æ‰§è¡Œ |

### 3.3 å®šæ—¶æŠ“åŒ…è„šæœ¬å®ç°


**ğŸ”§ å®Œæ•´çš„å®šæ—¶æŠ“åŒ…æ–¹æ¡ˆ**
```bash
#!/bin/bash
# å®šæ—¶æŠ“åŒ…è„šæœ¬ - /usr/local/bin/scheduled_capture.sh

# ============ é…ç½®å‚æ•° ============
CAPTURE_DIR="/var/network_captures"
LOG_FILE="/var/log/scheduled_capture.log" 
RETENTION_DAYS=7
MAX_FILE_SIZE="50M"

# ============ æ—¥å¿—å‡½æ•° ============
log_with_timestamp() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# ============ æ¸…ç†æ—§æ–‡ä»¶ ============
cleanup_old_files() {
    log_with_timestamp "æ¸…ç†${RETENTION_DAYS}å¤©å‰çš„æŠ“åŒ…æ–‡ä»¶"
    find "$CAPTURE_DIR" -name "*.pcap" -mtime +$RETENTION_DAYS -delete
    log_with_timestamp "æ¸…ç†å®Œæˆ"
}

# ============ æ‰§è¡ŒæŠ“åŒ… ============
perform_capture() {
    local timestamp=$(date +"%Y%m%d_%H%M")
    local capture_file="$CAPTURE_DIR/scheduled_${timestamp}.pcap"
    
    log_with_timestamp "å¼€å§‹å®šæ—¶æŠ“åŒ…ï¼š$capture_file"
    
    # æŠ“åŒ…30åˆ†é’Ÿ
    timeout 1800 tcpdump -i eth0 -w "$capture_file" -C "$MAX_FILE_SIZE"
    
    if [[ $? -eq 0 ]]; then
        log_with_timestamp "æŠ“åŒ…å®Œæˆï¼š$capture_file"
        log_with_timestamp "æ–‡ä»¶å¤§å°ï¼š$(du -h "$capture_file" | cut -f1)"
    else
        log_with_timestamp "æŠ“åŒ…å¼‚å¸¸é€€å‡º"
    fi
}

# ============ ä¸»æ‰§è¡Œé€»è¾‘ ============
main() {
    mkdir -p "$CAPTURE_DIR"
    cleanup_old_files
    perform_capture
}

main
```

**ğŸ“ crontabé…ç½®ç¤ºä¾‹**
```bash
# ç¼–è¾‘å®šæ—¶ä»»åŠ¡
crontab -e

# æ·»åŠ ä»¥ä¸‹é…ç½®
# æ¯2å°æ—¶æ‰§è¡Œä¸€æ¬¡æŠ“åŒ…
0 */2 * * * /usr/local/bin/scheduled_capture.sh

# æ¯å¤©å‡Œæ™¨1ç‚¹æ¸…ç†æ—¥å¿—
0 1 * * * find /var/log -name "*.log" -mtime +30 -delete
```

---

## 4. ğŸ¯ æ¡ä»¶è§¦å‘æœºåˆ¶å®ç°


### 4.1 ä»€ä¹ˆæ˜¯æ¡ä»¶è§¦å‘


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
æ¡ä»¶è§¦å‘ï¼šæ ¹æ®ç‰¹å®šæ¡ä»¶è‡ªåŠ¨å¯åŠ¨æŠ“åŒ…
å¸¸è§æ¡ä»¶ï¼šCPUä½¿ç”¨ç‡é«˜ã€ç½‘ç»œæµé‡å¼‚å¸¸ã€ç‰¹å®šç«¯å£æ´»åŠ¨
å®ç°æ–¹å¼ï¼šç›‘æ§è„šæœ¬ + é˜ˆå€¼åˆ¤æ–­ + è‡ªåŠ¨æŠ“åŒ…
```

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒæ±½è½¦çš„å®‰å…¨æ°”å›Šï¼Œå¹³æ—¶ä¸å·¥ä½œï¼Œä½†æ£€æµ‹åˆ°ç¢°æ’æ—¶ç«‹å³å¯åŠ¨

### 4.2 åŸºäºèµ„æºç›‘æ§çš„è§¦å‘


**ğŸ“Š CPUä½¿ç”¨ç‡è§¦å‘æŠ“åŒ…**
```bash
#!/bin/bash
# CPUä½¿ç”¨ç‡ç›‘æ§è§¦å‘è„šæœ¬

CPU_THRESHOLD=80
CHECK_INTERVAL=30
CAPTURE_DURATION=300

# è·å–CPUä½¿ç”¨ç‡
get_cpu_usage() {
    top -bn1 | grep "Cpu(s)" | awk '{print $2}' | sed 's/%us,//'
}

# æ£€æŸ¥æ˜¯å¦éœ€è¦æŠ“åŒ…
check_and_capture() {
    local cpu_usage=$(get_cpu_usage)
    local cpu_value=${cpu_usage%.*}  # å»é™¤å°æ•°éƒ¨åˆ†
    
    echo "å½“å‰CPUä½¿ç”¨ç‡ï¼š${cpu_usage}%"
    
    if [[ $cpu_value -gt $CPU_THRESHOLD ]]; then
        echo "âš ï¸  CPUä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼(${CPU_THRESHOLD}%)ï¼Œå¼€å§‹æŠ“åŒ…..."
        
        local timestamp=$(date +"%Y%m%d_%H%M%S")
        local capture_file="/var/captures/high_cpu_${timestamp}.pcap"
        
        # åå°æŠ“åŒ…
        tcpdump -i any -w "$capture_file" -G $CAPTURE_DURATION -W 1 &
        
        echo "âœ… æŠ“åŒ…å·²å¯åŠ¨ï¼Œæ–‡ä»¶ï¼š$capture_file"
        
        # è®°å½•äº‹ä»¶
        echo "[$(date)] CPUè§¦å‘æŠ“åŒ…: ä½¿ç”¨ç‡${cpu_usage}%" >> /var/log/trigger_events.log
    fi
}

# æŒç»­ç›‘æ§
while true; do
    check_and_capture
    sleep $CHECK_INTERVAL
done
```

### 4.3 åŸºäºç½‘ç»œæµé‡çš„è§¦å‘


**ğŸŒ ç½‘ç»œæµé‡å¼‚å¸¸æ£€æµ‹**
```bash
#!/bin/bash
# ç½‘ç»œæµé‡ç›‘æ§è§¦å‘è„šæœ¬

INTERFACE="eth0"
TRAFFIC_THRESHOLD_MB=100
CHECK_INTERVAL=60

# è·å–ç½‘ç»œæµé‡
get_network_traffic() {
    local interface="$1"
    local rx_bytes=$(cat /sys/class/net/$interface/statistics/rx_bytes)
    local tx_bytes=$(cat /sys/class/net/$interface/statistics/tx_bytes)
    
    # è½¬æ¢ä¸ºMB
    local total_mb=$(( (rx_bytes + tx_bytes) / 1024 / 1024 ))
    echo $total_mb
}

# æµé‡ç›‘æ§ä¸»å¾ªç¯
monitor_traffic() {
    local prev_traffic=0
    
    while true; do
        local current_traffic=$(get_network_traffic "$INTERFACE")
        local traffic_diff=$((current_traffic - prev_traffic))
        
        echo "ğŸ“Š ${CHECK_INTERVAL}ç§’å†…æµé‡å˜åŒ–ï¼š${traffic_diff}MB"
        
        if [[ $traffic_diff -gt $TRAFFIC_THRESHOLD_MB ]]; then
            echo "ğŸš¨ æ£€æµ‹åˆ°æµé‡å¼‚å¸¸ï¼"
            trigger_capture "traffic_spike" "$traffic_diff"
        fi
        
        prev_traffic=$current_traffic
        sleep $CHECK_INTERVAL
    done
}

# è§¦å‘æŠ“åŒ…
trigger_capture() {
    local reason="$1"
    local value="$2"
    local timestamp=$(date +"%Y%m%d_%H%M%S")
    local capture_file="/var/captures/${reason}_${timestamp}.pcap"
    
    echo "ğŸ¯ è§¦å‘æŠ“åŒ…ï¼šåŸå› =$reason, æ•°å€¼=$value"
    
    # æŠ“åŒ…5åˆ†é’Ÿ
    timeout 300 tcpdump -i "$INTERFACE" -w "$capture_file" -s 65535 &
    
    # è®°å½•è§¦å‘äº‹ä»¶
    echo "[$(date)] æµé‡è§¦å‘: $reason=$value" >> /var/log/auto_triggers.log
}

monitor_traffic
```

### 4.4 åŸºäºç«¯å£æ´»åŠ¨çš„è§¦å‘


**ğŸ”Œ ç‰¹å®šç«¯å£ç›‘æ§**
```bash
#!/bin/bash
# ç«¯å£æ´»åŠ¨ç›‘æ§è„šæœ¬

MONITORED_PORTS="22 80 443 3389"  # SSH, HTTP, HTTPS, RDP
SCAN_THRESHOLD=10                 # 10æ¬¡è¿æ¥å°è¯•è§¦å‘æŠ“åŒ…

# æ£€æŸ¥ç«¯å£è¿æ¥
check_port_activity() {
    local port="$1"
    
    # ç»Ÿè®¡æœ€è¿‘1åˆ†é’Ÿçš„è¿æ¥å°è¯•
    local connections=$(ss -tuln | grep ":$port " | wc -l)
    
    if [[ $connections -gt $SCAN_THRESHOLD ]]; then
        echo "ğŸ” æ£€æµ‹åˆ°ç«¯å£ $port å¼‚å¸¸æ´»åŠ¨ï¼š$connections ä¸ªè¿æ¥"
        start_port_capture "$port"
    fi
}

# å¯åŠ¨ç«¯å£æŠ“åŒ…
start_port_capture() {
    local port="$1"
    local timestamp=$(date +"%Y%m%d_%H%M%S")
    local capture_file="/var/captures/port_${port}_${timestamp}.pcap"
    
    echo "ğŸ¯ å¼€å§‹ç›‘æ§ç«¯å£ $port"
    
    # ä¸“é—¨æŠ“å–è¯¥ç«¯å£çš„æµé‡
    tcpdump -i any "port $port" -w "$capture_file" -G 600 -W 1 &
    
    echo "âœ… ç«¯å£ç›‘æ§å·²å¯åŠ¨ï¼š$capture_file"
}

# ä¸»ç›‘æ§å¾ªç¯
main() {
    echo "ğŸš€ å¯åŠ¨ç«¯å£æ´»åŠ¨ç›‘æ§..."
    echo "ç›‘æ§ç«¯å£ï¼š$MONITORED_PORTS"
    
    while true; do
        for port in $MONITORED_PORTS; do
            check_port_activity "$port"
        done
        sleep 30
    done
}

main
```

---

## 5. ğŸ”„ ç»“æœå¤„ç†ç®¡é“è®¾è®¡


### 5.1 ä»€ä¹ˆæ˜¯å¤„ç†ç®¡é“


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
å¤„ç†ç®¡é“ï¼šå°†tcpdumpçš„è¾“å‡ºé€šè¿‡ä¸€ç³»åˆ—ç¨‹åºè¿›è¡Œå¤„ç†
ä½œç”¨ï¼šå®æ—¶åˆ†æã€è¿‡æ»¤ã€è½¬æ¢ã€å­˜å‚¨æŠ“åŒ…æ•°æ®
åŸç†ï¼šåˆ©ç”¨Linuxç®¡é“(|)è¿æ¥å¤šä¸ªå¤„ç†ç¨‹åº
```

**ğŸ­ ç®¡é“å¤„ç†æµç¨‹**
```
tcpdumpè¾“å‡º â†’ è¿‡æ»¤å™¨ â†’ åˆ†æå™¨ â†’ æ ¼å¼åŒ– â†’ å­˜å‚¨/å‘Šè­¦

å®é™…ä¾‹å­ï¼š
tcpdump -i eth0 | grep "HTTP" | awk '{print $1,$3,$5}' | tee log.txt
```

### 5.2 å®æ—¶æ•°æ®å¤„ç†ç®¡é“


**ğŸ“Š HTTPè¯·æ±‚åˆ†æç®¡é“**
```bash
#!/bin/bash
# HTTPæµé‡å®æ—¶åˆ†æç®¡é“

analyze_http_traffic() {
    local interface="$1"
    local output_file="/var/log/http_analysis.log"
    
    echo "ğŸ” å¼€å§‹HTTPæµé‡å®æ—¶åˆ†æ..."
    
    tcpdump -i "$interface" -A -s 0 'tcp port 80' 2>/dev/null | \
    
    # ç¬¬ä¸€æ­¥ï¼šæå–HTTPè¯·æ±‚è¡Œ
    grep -E "GET|POST|PUT|DELETE" | \
    
    # ç¬¬äºŒæ­¥ï¼šæ ¼å¼åŒ–è¾“å‡º
    while read line; do
        timestamp=$(date '+%Y-%m-%d %H:%M:%S')
        
        # æå–è¯·æ±‚æ–¹æ³•å’ŒURL
        method=$(echo "$line" | awk '{print $1}')
        url=$(echo "$line" | awk '{print $2}')
        
        # æ ¼å¼åŒ–è¾“å‡º
        echo "[$timestamp] $method $url" | tee -a "$output_file"
        
        # æ£€æŸ¥æ˜¯å¦ä¸ºå¯ç–‘è¯·æ±‚
        if echo "$url" | grep -E "(admin|login|password|cmd|shell)"; then
            echo "âš ï¸  [ALERT] å¯ç–‘è¯·æ±‚ï¼š$method $url" | \
            tee -a "/var/log/security_alerts.log"
        fi
    done
}

analyze_http_traffic "eth0"
```

### 5.3 æ•°æ®ç»Ÿè®¡ä¸åˆ†æç®¡é“


**ğŸ“ˆ æµé‡ç»Ÿè®¡åˆ†æ**
```bash
#!/bin/bash
# å®æ—¶æµé‡ç»Ÿè®¡åˆ†æç®¡é“

traffic_statistics() {
    local interface="$1"
    local report_file="/var/log/traffic_stats.log"
    
    echo "ğŸ“Š å¯åŠ¨æµé‡ç»Ÿè®¡åˆ†æ..."
    
    tcpdump -i "$interface" -c 1000 2>/dev/null | \
    
    # ç»Ÿè®¡ä¸åŒåè®®çš„æ•°é‡
    awk '{
        if ($0 ~ /TCP/) tcp_count++
        else if ($0 ~ /UDP/) udp_count++
        else if ($0 ~ /ICMP/) icmp_count++
        else other_count++
    } END {
        print "=== æµé‡ç»Ÿè®¡æŠ¥å‘Š ==="
        print "TCP åŒ…æ•°é‡:", tcp_count
        print "UDP åŒ…æ•°é‡:", udp_count  
        print "ICMP åŒ…æ•°é‡:", icmp_count
        print "å…¶ä»–åè®®:", other_count
        print "æ€»åŒ…æ•°é‡:", tcp_count + udp_count + icmp_count + other_count
        print "================="
    }' | tee -a "$report_file"
}

traffic_statistics "eth0"
```

### 5.4 æ™ºèƒ½è¿‡æ»¤ä¸å‘Šè­¦ç®¡é“


**ğŸš¨ å®‰å…¨äº‹ä»¶æ£€æµ‹ç®¡é“**
```bash
#!/bin/bash
# å®‰å…¨äº‹ä»¶æ™ºèƒ½æ£€æµ‹ç®¡é“

security_monitor() {
    local interface="$1"
    
    echo "ğŸ›¡ï¸  å¯åŠ¨å®‰å…¨ç›‘æ§ç®¡é“..."
    
    tcpdump -i "$interface" -l 2>/dev/null | \
    
    # å¤šé‡æ£€æµ‹ç®¡é“
    while read packet; do
        local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
        
        # æ£€æµ‹ç«¯å£æ‰«æ
        if echo "$packet" | grep -q "Flags \[S\]"; then
            src_ip=$(echo "$packet" | awk '{print $3}' | cut -d'.' -f1-4)
            dst_port=$(echo "$packet" | awk '{print $5}' | cut -d'.' -f5)
            
            # è®°å½•æ‰«æå°è¯•
            echo "$src_ip $dst_port" >> /tmp/scan_attempts.tmp
            
            # æ£€æŸ¥æ˜¯å¦ä¸ºæ‰«æè¡Œä¸ºï¼ˆåŒä¸€IPçŸ­æ—¶é—´å†…å°è¯•å¤šä¸ªç«¯å£ï¼‰
            recent_scans=$(grep "$src_ip" /tmp/scan_attempts.tmp | \
                          tail -10 | sort -u | wc -l)
                          
            if [[ $recent_scans -gt 5 ]]; then
                alert_message="ğŸš¨ æ£€æµ‹åˆ°ç«¯å£æ‰«æï¼š$src_ip å°è¯•äº† $recent_scans ä¸ªç«¯å£"
                echo "[$timestamp] $alert_message" | \
                tee -a /var/log/security_alerts.log
                
                # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è‡ªåŠ¨é˜²å¾¡æªæ–½
                # echo "$src_ip" >> /etc/blocked_ips.txt
            fi
        fi
        
        # æ£€æµ‹å¤§é‡æ•°æ®ä¼ è¾“
        if echo "$packet" | grep -q "length [5-9][0-9][0-9][0-9]"; then
            echo "[$timestamp] ğŸ“Š å¤§æ•°æ®åŒ…ä¼ è¾“ï¼š$packet" >> /var/log/large_transfers.log
        fi
        
        # æ£€æµ‹DNSæŸ¥è¯¢å¼‚å¸¸
        if echo "$packet" | grep -q "DNS" && echo "$packet" | grep -E "\.(tk|ml|ga|cf)"; then
            echo "[$timestamp] ğŸ” å¯ç–‘åŸŸåæŸ¥è¯¢ï¼š$packet" >> /var/log/dns_suspicious.log
        fi
    done
}

security_monitor "eth0"
```

---

## 6. ğŸ“ æ—¥å¿—è®°å½•ä¸ç®¡ç†


### 6.1 æ—¥å¿—è®°å½•çš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆè¦åšæ—¥å¿—è®°å½•**
```
é—®é¢˜è¿½è¸ªï¼šå‡ºç°ç½‘ç»œé—®é¢˜æ—¶èƒ½å¿«é€Ÿå®šä½åŸå› 
æ€§èƒ½åˆ†æï¼šé€šè¿‡æ—¥å¿—åˆ†æç½‘ç»œæ€§èƒ½è¶‹åŠ¿
åˆè§„è¦æ±‚ï¼šå¾ˆå¤šä¼ä¸šéœ€è¦ä¿ç•™ç½‘ç»œè®¿é—®è®°å½•
æ•…éšœæ¢å¤ï¼šå¸®åŠ©å¿«é€Ÿæ¢å¤ç½‘ç»œæœåŠ¡
```

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šæ—¥å¿—å°±åƒæ±½è½¦çš„è¡Œè½¦è®°å½•ä»ªï¼Œå¹³æ—¶çœ‹ä¸å‡ºç”¨å¤„ï¼Œå…³é”®æ—¶åˆ»èƒ½æ•‘å‘½

### 6.2 ç»“æ„åŒ–æ—¥å¿—è®¾è®¡


**ğŸ“‹ æ ‡å‡†æ—¥å¿—æ ¼å¼**
```bash
#!/bin/bash
# ç»“æ„åŒ–æ—¥å¿—è®°å½•å‡½æ•°

# æ—¥å¿—çº§åˆ«å®šä¹‰
LOG_LEVEL_DEBUG=0
LOG_LEVEL_INFO=1
LOG_LEVEL_WARN=2
LOG_LEVEL_ERROR=3

CURRENT_LOG_LEVEL=$LOG_LEVEL_INFO
LOG_FILE="/var/log/tcpdump_monitor.log"

# é€šç”¨æ—¥å¿—å‡½æ•°
write_log() {
    local level="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local caller="${BASH_SOURCE[2]##*/}:${BASH_LINENO[1]}"
    
    echo "[$timestamp] [$level] [$caller] $message" | tee -a "$LOG_FILE"
}

# å„çº§åˆ«æ—¥å¿—å‡½æ•°
log_debug() {
    [[ $CURRENT_LOG_LEVEL -le $LOG_LEVEL_DEBUG ]] && write_log "DEBUG" "$1"
}

log_info() {
    [[ $CURRENT_LOG_LEVEL -le $LOG_LEVEL_INFO ]] && write_log "INFO" "$1"
}

log_warn() {
    [[ $CURRENT_LOG_LEVEL -le $LOG_LEVEL_WARN ]] && write_log "WARN" "$1"
}

log_error() {
    [[ $CURRENT_LOG_LEVEL -le $LOG_LEVEL_ERROR ]] && write_log "ERROR" "$1"
}

# ä½¿ç”¨ç¤ºä¾‹
log_info "tcpdumpç›‘æ§æœåŠ¡å¯åŠ¨"
log_warn "æ£€æµ‹åˆ°å¼‚å¸¸æµé‡ï¼Œå¼€å§‹è¯¦ç»†æŠ“åŒ…"
log_error "æŠ“åŒ…è¿›ç¨‹å¼‚å¸¸é€€å‡ºï¼Œé”™è¯¯ä»£ç ï¼š$?"
```

### 6.3 æ—¥å¿—è½®è½¬ä¸ç®¡ç†


**ğŸ”„ æ—¥å¿—è½®è½¬é…ç½®**
```bash
#!/bin/bash
# æ—¥å¿—ç®¡ç†è„šæœ¬

LOG_DIR="/var/log/tcpdump"
MAX_LOG_SIZE="100M"
RETENTION_DAYS=30

# æ£€æŸ¥æ—¥å¿—å¤§å°å¹¶è½®è½¬
rotate_logs() {
    local log_file="$1"
    
    if [[ -f "$log_file" ]]; then
        local file_size=$(du -m "$log_file" | cut -f1)
        
        if [[ $file_size -gt 100 ]]; then  # å¤§äº100MB
            local timestamp=$(date +"%Y%m%d_%H%M%S")
            local rotated_file="${log_file}.${timestamp}"
            
            echo "ğŸ“ è½®è½¬æ—¥å¿—ï¼š$log_file -> $rotated_file"
            mv "$log_file" "$rotated_file"
            
            # å‹ç¼©æ—§æ—¥å¿—
            gzip "$rotated_file"
            
            # åˆ›å»ºæ–°æ—¥å¿—æ–‡ä»¶
            touch "$log_file"
            chmod 644 "$log_file"
        fi
    fi
}

# æ¸…ç†è¿‡æœŸæ—¥å¿—
cleanup_old_logs() {
    echo "ğŸ§¹ æ¸…ç† $RETENTION_DAYS å¤©å‰çš„æ—¥å¿—æ–‡ä»¶"
    find "$LOG_DIR" -name "*.log.*.gz" -mtime +$RETENTION_DAYS -delete
    
    # æ¸…ç†ç©ºçš„æŠ“åŒ…æ–‡ä»¶
    find "$LOG_DIR" -name "*.pcap" -size 0 -delete
}

# ä¸»æ¸…ç†å‡½æ•°
main() {
    mkdir -p "$LOG_DIR"
    
    # è½®è½¬å„ç§æ—¥å¿—æ–‡ä»¶
    rotate_logs "$LOG_DIR/tcpdump_monitor.log"
    rotate_logs "$LOG_DIR/security_alerts.log"
    rotate_logs "$LOG_DIR/traffic_stats.log"
    
    # æ¸…ç†è¿‡æœŸæ–‡ä»¶
    cleanup_old_logs
    
    echo "âœ… æ—¥å¿—ç®¡ç†å®Œæˆ"
}

main
```

### 6.4 æ—¥å¿—åˆ†æä¸æŠ¥å‘Š


**ğŸ“Š è‡ªåŠ¨æ—¥å¿—åˆ†æ**
```bash
#!/bin/bash
# æ—¥å¿—åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆè„šæœ¬

LOG_FILE="/var/log/tcpdump_monitor.log"
REPORT_FILE="/var/reports/daily_network_report.txt"

# ç”Ÿæˆæ¯æ—¥æŠ¥å‘Š
generate_daily_report() {
    local today=$(date '+%Y-%m-%d')
    local report_date=$(date '+%Yå¹´%mæœˆ%dæ—¥')
    
    echo "ğŸ“ˆ ç½‘ç»œç›‘æ§æ—¥æŠ¥ - $report_date" > "$REPORT_FILE"
    echo "=================================" >> "$REPORT_FILE"
    echo "" >> "$REPORT_FILE"
    
    # ç»Ÿè®¡ä»Šæ—¥æ—¥å¿—æ¡ç›®
    local total_entries=$(grep "$today" "$LOG_FILE" | wc -l)
    echo "ğŸ“Š åŸºç¡€ç»Ÿè®¡ï¼š" >> "$REPORT_FILE"
    echo "  æ€»æ—¥å¿—æ¡ç›®ï¼š$total_entries" >> "$REPORT_FILE"
    
    # ç»Ÿè®¡å„çº§åˆ«æ—¥å¿—
    local info_count=$(grep "$today.*INFO" "$LOG_FILE" | wc -l)
    local warn_count=$(grep "$today.*WARN" "$LOG_FILE" | wc -l)
    local error_count=$(grep "$today.*ERROR" "$LOG_FILE" | wc -l)
    
    echo "  ä¿¡æ¯æ—¥å¿—ï¼š$info_count" >> "$REPORT_FILE"
    echo "  è­¦å‘Šæ—¥å¿—ï¼š$warn_count" >> "$REPORT_FILE"
    echo "  é”™è¯¯æ—¥å¿—ï¼š$error_count" >> "$REPORT_FILE"
    echo "" >> "$REPORT_FILE"
    
    # åˆ†æé«˜é¢‘äº‹ä»¶
    echo "ğŸ” é«˜é¢‘äº‹ä»¶åˆ†æï¼š" >> "$REPORT_FILE"
    grep "$today" "$LOG_FILE" | \
    grep -o "æ£€æµ‹åˆ°.*" | \
    sort | uniq -c | sort -nr | head -5 >> "$REPORT_FILE"
    
    echo "" >> "$REPORT_FILE"
    
    # é”™è¯¯äº‹ä»¶è¯¦æƒ…
    if [[ $error_count -gt 0 ]]; then
        echo "âŒ é”™è¯¯äº‹ä»¶è¯¦æƒ…ï¼š" >> "$REPORT_FILE"
        grep "$today.*ERROR" "$LOG_FILE" | tail -10 >> "$REPORT_FILE"
    fi
    
    echo "æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼š$REPORT_FILE"
}

generate_daily_report
```

---

## 7. ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœºåˆ¶


### 7.1 å¸¸è§é”™è¯¯ç±»å‹


**âš ï¸ tcpdumpè„šæœ¬å¸¸è§é”™è¯¯**

| **é”™è¯¯ç±»å‹** | **å…¸å‹ç°è±¡** | **åŸå› åˆ†æ** | **è§£å†³æ–¹æ¡ˆ** |
|-------------|-------------|-------------|-------------|
| **æƒé™é”™è¯¯** | `tcpdump: permission denied` | érootç”¨æˆ·æ‰§è¡Œ | ä½¿ç”¨sudoæˆ–åˆ‡æ¢åˆ°root |
| **æ¥å£é”™è¯¯** | `tcpdump: interface not found` | ç½‘ç»œæ¥å£ä¸å­˜åœ¨ | æ£€æŸ¥æ¥å£åç§° |
| **ç£ç›˜ç©ºé—´** | `tcpdump: no space left` | ç£ç›˜ç©ºé—´ä¸è¶³ | æ¸…ç†ç©ºé—´æˆ–æ›´æ¢ç›®å½• |
| **è¿›ç¨‹å†²çª** | `tcpdump: device busy` | å¤šä¸ªè¿›ç¨‹å ç”¨æ¥å£ | åœæ­¢å…¶ä»–æŠ“åŒ…è¿›ç¨‹ |

### 7.2 å®Œå–„çš„é”™è¯¯æ£€æŸ¥æœºåˆ¶


**ğŸ”§ é¢„æ£€æŸ¥å‡½æ•°é›†åˆ**
```bash
#!/bin/bash
# å®Œæ•´çš„é”™è¯¯æ£€æŸ¥æœºåˆ¶

# æ£€æŸ¥è„šæœ¬æ‰§è¡Œæƒé™
check_permissions() {
    if [[ $EUID -ne 0 ]]; then
        echo "âŒ é”™è¯¯ï¼šéœ€è¦rootæƒé™æ‰§è¡Œç½‘ç»œæŠ“åŒ…"
        echo "ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ 'sudo $0' æ‰§è¡Œè„šæœ¬"
        exit 1
    fi
    echo "âœ… æƒé™æ£€æŸ¥é€šè¿‡"
}

# æ£€æŸ¥ç½‘ç»œæ¥å£
check_interface() {
    local interface="$1"
    
    if [[ -z "$interface" ]]; then
        echo "âŒ é”™è¯¯ï¼šæœªæŒ‡å®šç½‘ç»œæ¥å£"
        echo "ğŸ’¡ å¯ç”¨æ¥å£ï¼š"
        ip link show | grep -E "^[0-9]+" | awk -F': ' '{print "   " $2}'
        exit 1
    fi
    
    if ! ip link show "$interface" >/dev/null 2>&1; then
        echo "âŒ é”™è¯¯ï¼šç½‘ç»œæ¥å£ '$interface' ä¸å­˜åœ¨"
        echo "ğŸ’¡ å¯ç”¨æ¥å£ï¼š"
        ip link show | grep -E "^[0-9]+" | awk -F': ' '{print "   " $2}'
        exit 1
    fi
    
    echo "âœ… ç½‘ç»œæ¥å£æ£€æŸ¥é€šè¿‡ï¼š$interface"
}

# æ£€æŸ¥ç£ç›˜ç©ºé—´
check_disk_space() {
    local output_dir="$1"
    local min_space_mb=100  # æœ€å°‘éœ€è¦100MBç©ºé—´
    
    # è·å–å¯ç”¨ç©ºé—´ï¼ˆMBï¼‰
    local available_space=$(df -m "$output_dir" | awk 'NR==2 {print $4}')
    
    if [[ $available_space -lt $min_space_mb ]]; then
        echo "âŒ é”™è¯¯ï¼šç£ç›˜ç©ºé—´ä¸è¶³"
        echo "ğŸ’¡ å½“å‰å¯ç”¨ï¼š${available_space}MBï¼Œå»ºè®®æœ€å°‘ï¼š${min_space_mb}MB"
        exit 1
    fi
    
    echo "âœ… ç£ç›˜ç©ºé—´æ£€æŸ¥é€šè¿‡ï¼š${available_space}MBå¯ç”¨"
}

# æ£€æŸ¥tcpdumpæ˜¯å¦å¯ç”¨
check_tcpdump() {
    if ! command -v tcpdump >/dev/null 2>&1; then
        echo "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ°tcpdumpå‘½ä»¤"
        echo "ğŸ’¡ å®‰è£…å‘½ä»¤ï¼š"
        echo "   Ubuntu/Debian: apt-get install tcpdump"
        echo "   CentOS/RHEL:   yum install tcpdump"
        exit 1
    fi
    
    # æ£€æŸ¥tcpdumpç‰ˆæœ¬
    local version=$(tcpdump --version 2>&1 | head -1)
    echo "âœ… tcpdumpæ£€æŸ¥é€šè¿‡ï¼š$version"
}

# æ£€æŸ¥è¿›ç¨‹å†²çª
check_process_conflict() {
    local interface="$1"
    
    # æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–tcpdumpè¿›ç¨‹åœ¨ä½¿ç”¨è¯¥æ¥å£
    local existing_pid=$(ps aux | grep "tcpdump.*$interface" | grep -v grep | awk '{print $2}')
    
    if [[ -n "$existing_pid" ]]; then
        echo "âš ï¸  è­¦å‘Šï¼šæ£€æµ‹åˆ°å…¶ä»–tcpdumpè¿›ç¨‹æ­£åœ¨ä½¿ç”¨æ¥å£ $interface"
        echo "ğŸ” è¿›ç¨‹IDï¼š$existing_pid"
        
        read -p "æ˜¯å¦ç»ˆæ­¢ç°æœ‰è¿›ç¨‹å¹¶ç»§ç»­ï¼Ÿ(y/N): " confirm
        if [[ "$confirm" =~ ^[Yy]$ ]]; then
            kill -TERM $existing_pid
            sleep 2
            echo "âœ… å·²ç»ˆæ­¢å†²çªè¿›ç¨‹"
        else
            echo "âŒ ç”¨æˆ·å–æ¶ˆæ‰§è¡Œ"
            exit 1
        fi
    fi
}

# ç»¼åˆé¢„æ£€æŸ¥å‡½æ•°
perform_pre_checks() {
    local interface="$1"
    local output_dir="$2"
    
    echo "ğŸ” æ‰§è¡Œç³»ç»Ÿé¢„æ£€æŸ¥..."
    
    check_permissions
    check_tcpdump
    check_interface "$interface"
    check_disk_space "$output_dir"
    check_process_conflict "$interface"
    
    echo "âœ… æ‰€æœ‰é¢„æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥å¼€å§‹æ‰§è¡Œ"
    echo ""
}
```

### 7.3 è¿è¡Œæ—¶é”™è¯¯å¤„ç†


**ğŸƒâ€â™‚ï¸ æ‰§è¡Œè¿‡ç¨‹é”™è¯¯å¤„ç†**
```bash
#!/bin/bash
# è¿è¡Œæ—¶é”™è¯¯å¤„ç†æœºåˆ¶

# è®¾ç½®é”™è¯¯å¤„ç†é€‰é¡¹
set -euo pipefail  # ä»»ä½•é”™è¯¯éƒ½ä¼šå¯¼è‡´è„šæœ¬é€€å‡º

# é”™è¯¯ä¿¡å·å¤„ç†
cleanup_on_error() {
    local exit_code=$?
    local line_number=$1
    
    echo "ğŸ’¥ è„šæœ¬åœ¨ç¬¬ $line_number è¡Œå‘ç”Ÿé”™è¯¯ï¼Œé€€å‡ºç ï¼š$exit_code"
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    [[ -f "$TEMP_CAPTURE_FILE" ]] && rm -f "$TEMP_CAPTURE_FILE"
    
    # åœæ­¢åå°è¿›ç¨‹
    [[ -n "${TCPDUMP_PID:-}" ]] && kill -TERM "$TCPDUMP_PID" 2>/dev/null
    
    # è®°å½•é”™è¯¯æ—¥å¿—
    echo "[$(date)] è„šæœ¬å¼‚å¸¸é€€å‡ºï¼šè¡Œå·=$line_number, é”™è¯¯ç =$exit_code" >> /var/log/script_errors.log
    
    exit $exit_code
}

# ä¿¡å·å¤„ç†
cleanup_on_signal() {
    echo "ğŸ›‘ æ”¶åˆ°ç»ˆæ­¢ä¿¡å·ï¼Œæ­£åœ¨æ¸…ç†èµ„æº..."
    
    # ä¼˜é›…åœæ­¢tcpdumpè¿›ç¨‹
    if [[ -n "${TCPDUMP_PID:-}" ]]; then
        echo "åœæ­¢tcpdumpè¿›ç¨‹ï¼š$TCPDUMP_PID"
        kill -TERM "$TCPDUMP_PID" 2>/dev/null
        wait "$TCPDUMP_PID" 2>/dev/null
    fi
    
    echo "âœ… èµ„æºæ¸…ç†å®Œæˆ"
    exit 0
}

# æ³¨å†Œé”™è¯¯å¤„ç†å‡½æ•°
trap 'cleanup_on_error $LINENO' ERR
trap 'cleanup_on_signal' SIGINT SIGTERM

# å¸¦é”™è¯¯å¤„ç†çš„tcpdumpæ‰§è¡Œ
safe_tcpdump() {
    local interface="$1"
    local output_file="$2"
    local duration="$3"
    
    echo "ğŸš€ å¯åŠ¨tcpdumpæŠ“åŒ…..."
    
    # ä½¿ç”¨timeouté˜²æ­¢è¿›ç¨‹æŒ‚èµ·
    timeout "$duration" tcpdump -i "$interface" -w "$output_file" &
    TCPDUMP_PID=$!
    
    echo "ğŸ“ tcpdumpè¿›ç¨‹IDï¼š$TCPDUMP_PID"
    
    # ç›‘æ§è¿›ç¨‹çŠ¶æ€
    while kill -0 "$TCPDUMP_PID" 2>/dev/null; do
        echo "â±ï¸  æŠ“åŒ…è¿›è¡Œä¸­...ï¼ˆPID: $TCPDUMP_PIDï¼‰"
        sleep 10
    done
    
    wait "$TCPDUMP_PID"
    local exit_code=$?
    
    if [[ $exit_code -eq 0 ]] || [[ $exit_code -eq 124 ]]; then  # 124æ˜¯timeoutçš„é€€å‡ºç 
        echo "âœ… æŠ“åŒ…å®Œæˆ"
    else
        echo "âŒ æŠ“åŒ…å¼‚å¸¸ç»“æŸï¼Œé€€å‡ºç ï¼š$exit_code"
        return $exit_code
    fi
}
```

### 7.4 é”™è¯¯æ¢å¤æœºåˆ¶


**ğŸ”„ è‡ªåŠ¨æ¢å¤ç­–ç•¥**
```bash
#!/bin/bash
# è‡ªåŠ¨é”™è¯¯æ¢å¤æœºåˆ¶

MAX_RETRY_ATTEMPTS=3
RETRY_INTERVAL=5

# å¸¦é‡è¯•çš„æ‰§è¡Œå‡½æ•°
execute_with_retry() {
    local command="$1"
    local description="$2"
    local attempt=1
    
    while [[ $attempt -le $MAX_RETRY_ATTEMPTS ]]; do
        echo "ğŸ”„ å°è¯•æ‰§è¡Œï¼š$description (ç¬¬ $attempt/$MAX_RETRY_ATTEMPTS æ¬¡)"
        
        if eval "$command"; then
            echo "âœ… æ‰§è¡ŒæˆåŠŸï¼š$description"
            return 0
        else
            local exit_code=$?
            echo "âŒ æ‰§è¡Œå¤±è´¥ï¼š$description (é€€å‡ºç ï¼š$exit_code)"
            
            if [[ $attempt -lt $MAX_RETRY_ATTEMPTS ]]; then
                echo "â³ ${RETRY_INTERVAL}ç§’åé‡è¯•..."
                sleep $RETRY_INTERVAL
                ((attempt++))
            else
                echo "ğŸ’¥ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ‰§è¡Œå¤±è´¥"
                return $exit_code
            fi
        fi
    done
}

# ä½¿ç”¨ç¤ºä¾‹
execute_with_retry \
    "tcpdump -i eth0 -w /tmp/test.pcap -c 10" \
    "ç½‘ç»œæŠ“åŒ…æµ‹è¯•"

execute_with_retry \
    "ping -c 3 8.8.8.8 >/dev/null" \
    "ç½‘ç»œè¿é€šæ€§æµ‹è¯•"
```

---

## 8. âš¡ è„šæœ¬æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 8.1 æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–æ€§èƒ½**
```
èµ„æºæ¶ˆè€—ï¼štcpdumpæœ¬èº«ä¼šæ¶ˆè€—CPUå’Œå†…å­˜
å­˜å‚¨å‹åŠ›ï¼šæŠ“åŒ…æ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼Œå½±å“ç£ç›˜I/O
ç½‘ç»œå½±å“ï¼šä¸å½“çš„æŠ“åŒ…å¯èƒ½å½±å“æ­£å¸¸ç½‘ç»œæµé‡
ç³»ç»Ÿç¨³å®šæ€§ï¼šé«˜è´Ÿè½½å¯èƒ½å½±å“ç³»ç»Ÿæ•´ä½“æ€§èƒ½
```

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šæ€§èƒ½ä¼˜åŒ–å°±åƒç»™æ±½è½¦åšä¿å…»ï¼Œè®©å®ƒè·‘å¾—æ›´å¿«æ›´ç¨³å®š

### 8.2 tcpdumpå‚æ•°ä¼˜åŒ–


**âš¡ å…³é”®å‚æ•°è°ƒä¼˜**

| **å‚æ•°** | **ä½œç”¨** | **ä¼˜åŒ–å»ºè®®** | **æ€§èƒ½å½±å“** |
|---------|---------|-------------|-------------|
| **-s** | æŠ“åŒ…é•¿åº¦ | æ ¹æ®éœ€è¦è®¾ç½®ï¼Œä¸è¦ç”¨0 | ğŸŸ¢ å‡å°‘å†…å­˜ä½¿ç”¨ |
| **-c** | åŒ…æ•°é‡é™åˆ¶ | è®¾ç½®åˆç†ä¸Šé™ | ğŸŸ¢ æ§åˆ¶è¿è¡Œæ—¶é—´ |
| **-C** | æ–‡ä»¶å¤§å°é™åˆ¶ | è®¾ç½®é€‚ä¸­å€¼(10-50MB) | ğŸŸ¢ é¿å…å•æ–‡ä»¶è¿‡å¤§ |
| **-W** | æ–‡ä»¶æ•°é‡é™åˆ¶ | æ§åˆ¶è½®è½¬æ–‡ä»¶æ•°é‡ | ğŸŸ¢ ç®¡ç†ç£ç›˜ç©ºé—´ |
| **-B** | ç¼“å†²åŒºå¤§å° | é«˜æµé‡æ—¶å¢å¤§ | ğŸŸ¡ å¹³è¡¡å†…å­˜å’Œæ€§èƒ½ |

**ğŸ”§ ä¼˜åŒ–é…ç½®ç¤ºä¾‹**
```bash
#!/bin/bash
# æ€§èƒ½ä¼˜åŒ–çš„tcpdumpé…ç½®

# åŸºç¡€ä¼˜åŒ–é…ç½®
optimize_basic_capture() {
    local interface="$1"
    local output_file="$2"
    
    tcpdump -i "$interface" \
            -w "$output_file" \
            -s 96 \           # åªæŠ“åŒ…å¤´ï¼ŒèŠ‚çœç©ºé—´
            -C 10 \           # 10MBè½®è½¬
            -W 5 \            # ä¿ç•™5ä¸ªæ–‡ä»¶
            -B 4096 \         # 4MBç¼“å†²åŒº
            --time-stamp-precision=micro  # å¾®ç§’ç²¾åº¦
}

# é«˜æ€§èƒ½é…ç½®ï¼ˆå¤§æµé‡ç¯å¢ƒï¼‰
optimize_high_performance() {
    local interface="$1"
    local output_file="$2"
    
    tcpdump -i "$interface" \
            -w "$output_file" \
            -s 128 \          # ç¨å¤§çš„åŒ…å¤´
            -C 50 \           # 50MBè½®è½¬
            -W 10 \           # æ›´å¤šè½®è½¬æ–‡ä»¶
            -B 16384 \        # 16MBå¤§ç¼“å†²åŒº
            --immediate-mode \  # ç«‹å³æ¨¡å¼ï¼Œå‡å°‘å»¶è¿Ÿ
            -q                  # ç®€åŒ–è¾“å‡ºï¼Œæé«˜æ€§èƒ½
}

# å†…å­˜ä¼˜åŒ–é…ç½®ï¼ˆèµ„æºå—é™ç¯å¢ƒï¼‰
optimize_memory_limited() {
    local interface="$1"
    local output_file="$2"
    
    tcpdump -i "$interface" \
            -w "$output_file" \
            -s 64 \           # æœ€å°åŒ…å¤´
            -C 5 \            # å°æ–‡ä»¶è½®è½¬
            -W 3 \            # å°‘é‡æ–‡ä»¶
            -B 1024           # 1MBå°ç¼“å†²åŒº
}
```

### 8.3 è„šæœ¬æ‰§è¡Œä¼˜åŒ–


**ğŸš€ è„šæœ¬æ€§èƒ½æå‡æŠ€å·§**
```bash
#!/bin/bash
# è„šæœ¬æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹

# ä¼˜åŒ–1ï¼šä½¿ç”¨æ•°ç»„è€Œéå¤šæ¬¡grep
optimize_log_analysis() {
    local log_file="$1"
    
    # ä½æ•ˆæ–¹å¼
    # local info_count=$(grep "INFO" "$log_file" | wc -l)
    # local warn_count=$(grep "WARN" "$log_file" | wc -l)
    # local error_count=$(grep "ERROR" "$log_file" | wc -l)
    
    # é«˜æ•ˆæ–¹å¼ï¼šä¸€æ¬¡è¯»å–ï¼Œå¤šé‡ç»Ÿè®¡
    declare -A counters
    counters[INFO]=0
    counters[WARN]=0
    counters[ERROR]=0
    
    while IFS= read -r line; do
        case "$line" in
            *INFO*) ((counters[INFO]++)) ;;
            *WARN*) ((counters[WARN]++)) ;;
            *ERROR*) ((counters[ERROR]++)) ;;
        esac
    done < "$log_file"
    
    echo "INFO: ${counters[INFO]}"
    echo "WARN: ${counters[WARN]}"
    echo "ERROR: ${counters[ERROR]}"
}

# ä¼˜åŒ–2ï¼šä½¿ç”¨å†…å»ºå‘½ä»¤è€Œéå¤–éƒ¨ç¨‹åº
optimize_file_operations() {
    local file="$1"
    
    # ä½æ•ˆï¼šä½¿ç”¨å¤–éƒ¨å‘½ä»¤
    # if [[ $(wc -l < "$file") -gt 1000 ]]; then
    
    # é«˜æ•ˆï¼šä½¿ç”¨å†…å»ºåŠŸèƒ½
    local line_count=0
    while IFS= read -r line; do
        ((line_count++))
        [[ $line_count -gt 1000 ]] && break
    done < "$file"
    
    if [[ $line_count -gt 1000 ]]; then
        echo "æ–‡ä»¶è¡Œæ•°è¶…è¿‡1000ï¼Œéœ€è¦è½®è½¬"
    fi
}

# ä¼˜åŒ–3ï¼šå¹¶è¡Œå¤„ç†
optimize_parallel_processing() {
    local interfaces=("eth0" "eth1" "wlan0")
    
    # å¹¶è¡Œå¯åŠ¨å¤šä¸ªæŠ“åŒ…ä»»åŠ¡
    for interface in "${interfaces[@]}"; do
        if ip link show "$interface" >/dev/null 2>&1; then
            {
                echo "å¯åŠ¨ $interface æŠ“åŒ…"
                tcpdump -i "$interface" -w "/tmp/capture_${interface}.pcap" -c 100
                echo "$interface æŠ“åŒ…å®Œæˆ"
            } &
        fi
    done
    
    # ç­‰å¾…æ‰€æœ‰åå°ä»»åŠ¡å®Œæˆ
    wait
    echo "æ‰€æœ‰æŠ“åŒ…ä»»åŠ¡å®Œæˆ"
}
```

### 8.4 ç³»ç»Ÿèµ„æºç›‘æ§


**ğŸ“Š èµ„æºä½¿ç”¨ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# ç³»ç»Ÿèµ„æºç›‘æ§è„šæœ¬

monitor_system_resources() {
    local monitoring_duration=300  # ç›‘æ§5åˆ†é’Ÿ
    local check_interval=10       # æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
    
    echo "ğŸ“Š å¼€å§‹ç³»ç»Ÿèµ„æºç›‘æ§..."
    
    local end_time=$(($(date +%s) + monitoring_duration))
    
    while [[ $(date +%s) -lt $end_time ]]; do
        # CPUä½¿ç”¨ç‡
        local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | sed 's/%us,//')
        
        # å†…å­˜ä½¿ç”¨ç‡
        local mem_usage=$(free | grep Mem | awk '{printf "%.1f", $3/$2 * 100.0}')
        
        # ç£ç›˜I/O
        local disk_io=$(iostat -d 1 1 | grep -v "^$" | tail -1 | awk '{print $4}')
        
        # ç½‘ç»œæµé‡
        local rx_bytes=$(cat /sys/class/net/eth0/statistics/rx_bytes)
        local tx_bytes=$(cat /sys/class/net/eth0/statistics/tx_bytes)
        
        echo "[$(date '+%H:%M:%S')] CPU:${cpu_usage}% MEM:${mem_usage}% IO:${disk_io} NET:$((rx_bytes+tx_bytes))"
        
        # æ£€æŸ¥èµ„æºä½¿ç”¨æ˜¯å¦è¿‡é«˜
        if (( $(echo "$cpu_usage > 80" | bc -l) )); then
            echo "âš ï¸  CPUä½¿ç”¨ç‡è¿‡é«˜ï¼š${cpu_usage}%"
        fi
        
        if (( $(echo "$mem_usage > 85" | bc -l) )); then
            echo "âš ï¸  å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼š${mem_usage}%"
        fi
        
        sleep $check_interval
    done
}

monitor_system_resources
```

### 8.5 å­˜å‚¨ç©ºé—´ä¼˜åŒ–


**ğŸ’¾ ç£ç›˜ç©ºé—´ç®¡ç†ç­–ç•¥**
```bash
#!/bin/bash
# å­˜å‚¨ç©ºé—´ä¼˜åŒ–ç®¡ç†

CAPTURE_DIR="/var/network_captures"
MAX_DIR_SIZE_GB=10  # æœ€å¤§ç›®å½•å¤§å°10GB
COMPRESSION_AGE_DAYS=1  # 1å¤©åå‹ç¼©
DELETE_AGE_DAYS=30      # 30å¤©ååˆ é™¤

# æ£€æŸ¥ç›®å½•å¤§å°
check_directory_size() {
    local dir="$1"
    local size_gb=$(du -sg "$dir" 2>/dev/null | cut -f1)
    
    if [[ $size_gb -gt $MAX_DIR_SIZE_GB ]]; then
        echo "âš ï¸  ç›®å½•å¤§å°è¶…é™ï¼š${size_gb}GB > ${MAX_DIR_SIZE_GB}GB"
        return 1
    else
        echo "âœ… ç›®å½•å¤§å°æ­£å¸¸ï¼š${size_gb}GB"
        return 0
    fi
}

# æ™ºèƒ½å‹ç¼©ç­–ç•¥
intelligent_compression() {
    local dir="$1"
    
    echo "ğŸ—œï¸  å¼€å§‹æ™ºèƒ½å‹ç¼©..."
    
    # å‹ç¼©1å¤©å‰çš„æ–‡ä»¶
    find "$dir" -name "*.pcap" -mtime +$COMPRESSION_AGE_DAYS -not -name "*.gz" | \
    while read file; do
        echo "å‹ç¼©æ–‡ä»¶ï¼š$file"
        gzip "$file"
        
        # æ£€æŸ¥å‹ç¼©æ•ˆæœ
        local original_size=$(stat -c%s "${file}.gz" 2>/dev/null || echo 0)
        if [[ $original_size -gt 0 ]]; then
            echo "âœ… å‹ç¼©å®Œæˆï¼š$file"
        else
            echo "âŒ å‹ç¼©å¤±è´¥ï¼š$file"
        fi
    done
}

# è‡ªåŠ¨æ¸…ç†ç­–ç•¥
auto_cleanup() {
    local dir="$1"
    
    echo "ğŸ§¹ å¼€å§‹è‡ªåŠ¨æ¸…ç†..."
    
    # åˆ é™¤30å¤©å‰çš„å‹ç¼©æ–‡ä»¶
    local deleted_count=$(find "$dir" -name "*.pcap.gz" -mtime +$DELETE_AGE_DAYS -delete -print | wc -l)
    echo "ğŸ—‘ï¸  åˆ é™¤äº† $deleted_count ä¸ªè¿‡æœŸæ–‡ä»¶"
    
    # åˆ é™¤ç©ºæ–‡ä»¶
    find "$dir" -size 0 -delete
    echo "ğŸ—‘ï¸  æ¸…ç†äº†æ‰€æœ‰ç©ºæ–‡ä»¶"
    
    # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
    find "$dir" -name "*.tmp" -delete
    echo "ğŸ—‘ï¸  æ¸…ç†äº†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶"
}

# å­˜å‚¨ä¼˜åŒ–ä¸»å‡½æ•°
optimize_storage() {
    mkdir -p "$CAPTURE_DIR"
    
    if ! check_directory_size "$CAPTURE_DIR"; then
        echo "ğŸš¨ å­˜å‚¨ç©ºé—´å‘Šæ€¥ï¼Œæ‰§è¡Œç´§æ€¥æ¸…ç†..."
        auto_cleanup "$CAPTURE_DIR"
        intelligent_compression "$CAPTURE_DIR"
    else
        echo "ğŸ“Š å®šæœŸç»´æŠ¤æ¨¡å¼"
        intelligent_compression "$CAPTURE_DIR"
    fi
}

optimize_storage
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è„šæœ¬åŒ–æœ¬è´¨ï¼šå°†tcpdumpé›†æˆåˆ°è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹ä¸­
ğŸ”¸ æ ¸å¿ƒä¼˜åŠ¿ï¼š24/7ç›‘æ§ã€è‡ªåŠ¨åˆ†æã€å¿«é€Ÿå“åº”ã€å¯é‡ç°
ğŸ”¸ åŸºæœ¬ç»“æ„ï¼šé…ç½®å‚æ•°ã€å‡½æ•°å®šä¹‰ã€æ‰§è¡Œé€»è¾‘ã€é”™è¯¯å¤„ç†
ğŸ”¸ å…³é”®æŠ€èƒ½ï¼šshellç¼–ç¨‹ã€æ­£åˆ™è¡¨è¾¾å¼ã€ç®¡é“å¤„ç†ã€ç³»ç»Ÿç®¡ç†
```

### 9.2 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç½‘ç»œè¿ç»´**ï¼šè‡ªåŠ¨ç›‘æ§ç½‘ç»œçŠ¶æ€ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸
- **å®‰å…¨é˜²æŠ¤**ï¼šå®æ—¶æ£€æµ‹æ”»å‡»è¡Œä¸ºï¼Œè‡ªåŠ¨è§¦å‘é˜²æŠ¤æªæ–½
- **æ•…éšœè¯Šæ–­**ï¼šå¿«é€Ÿæ”¶é›†æ•…éšœæ—¶çš„ç½‘ç»œæ•°æ®ï¼ŒåŠ é€Ÿé—®é¢˜è§£å†³
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé•¿æœŸæ”¶é›†ç½‘ç»œæ€§èƒ½æ•°æ®ï¼Œæ”¯æŒå®¹é‡è§„åˆ’

**ğŸ“š å­¦ä¹ æ£€æŸ¥ç‚¹**
- [ ] èƒ½å¤Ÿç¼–å†™åŸºæœ¬çš„tcpdumpè‡ªåŠ¨åŒ–è„šæœ¬
- [ ] ç†è§£å®šæ—¶ä»»åŠ¡çš„é…ç½®å’Œç®¡ç†
- [ ] æŒæ¡æ¡ä»¶è§¦å‘æœºåˆ¶çš„å®ç°æ–¹æ³•
- [ ] ä¼šè®¾è®¡æ•°æ®å¤„ç†ç®¡é“
- [ ] èƒ½å¤Ÿå®ç°å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

### 9.3 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è„šæœ¬åŒ–çš„æ ¸å¿ƒæ€æƒ³**
```
è‡ªåŠ¨åŒ–åŸåˆ™ï¼š
- å‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜å·¥ä½œæ•ˆç‡
- æ ‡å‡†åŒ–æµç¨‹ï¼Œé¿å…äººä¸ºé”™è¯¯
- æŒç»­ç›‘æ§ï¼Œä¸é—æ¼å…³é”®äº‹ä»¶

å¯ç»´æŠ¤æ€§åŸåˆ™ï¼š
- æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŠŸèƒ½ç‹¬ç«‹
- å……åˆ†çš„æ—¥å¿—è®°å½•
- å®Œå–„çš„é”™è¯¯å¤„ç†
- æ¸…æ™°çš„ä»£ç æ³¨é‡Š
```

**ğŸ”¹ æ€§èƒ½ä¸åŠŸèƒ½çš„å¹³è¡¡**
```
æ€§èƒ½è€ƒè™‘ï¼š
- åˆç†è®¾ç½®tcpdumpå‚æ•°
- ä¼˜åŒ–è„šæœ¬æ‰§è¡Œæ•ˆç‡
- æ§åˆ¶èµ„æºæ¶ˆè€—
- ç®¡ç†å­˜å‚¨ç©ºé—´

åŠŸèƒ½éœ€æ±‚ï¼š
- æ»¡è¶³ç›‘æ§è¦æ±‚
- ä¿è¯æ•°æ®å®Œæ•´æ€§
- æ”¯æŒçµæ´»é…ç½®
- æä¾›ä¸°å¯Œçš„åˆ†æåŠŸèƒ½
```

### 9.4 å®è·µå»ºè®®


**ğŸš€ æœ€ä½³å®è·µ**
```
å¼€å‘å»ºè®®ï¼š
1. ä»ç®€å•è„šæœ¬å¼€å§‹ï¼Œé€æ­¥å¢åŠ åŠŸèƒ½
2. é‡è§†é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µ
3. å……åˆ†æµ‹è¯•å„ç§åœºæ™¯
4. å»ºç«‹ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

éƒ¨ç½²å»ºè®®ï¼š
1. é€‰æ‹©åˆé€‚çš„è¿è¡Œç¯å¢ƒ
2. é…ç½®é€‚å½“çš„æƒé™æ§åˆ¶
3. è®¾ç½®åˆç†çš„èµ„æºé™åˆ¶
4. å»ºç«‹å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

ç»´æŠ¤å»ºè®®ï¼š
1. å®šæœŸæ£€æŸ¥è„šæœ¬è¿è¡ŒçŠ¶æ€
2. åŠæ—¶å¤„ç†æ—¥å¿—å’Œå‘Šè­¦ä¿¡æ¯
3. æ ¹æ®éœ€æ±‚è°ƒæ•´é…ç½®å‚æ•°
4. æŒç»­ä¼˜åŒ–æ€§èƒ½å’ŒåŠŸèƒ½
```

**ğŸ¯ ä¸€å¥è¯æ€»ç»“**
> tcpdumpè„šæœ¬åŒ–æ˜¯å°†ç½‘ç»œç›‘æ§ä»æ‰‹å·¥æ“ä½œå‡çº§ä¸ºè‡ªåŠ¨åŒ–ç³»ç»Ÿçš„å…³é”®æŠ€æœ¯ï¼ŒæŒæ¡å®ƒèƒ½è®©æˆ‘ä»¬æ„å»ºå‡ºæ™ºèƒ½ã€é«˜æ•ˆã€å¯é çš„ç½‘ç»œç›‘æ§ä½“ç³»ã€‚

**ğŸ”‘ å…³é”®è®°å¿†è¦ç‚¹**
- è„šæœ¬åŒ–è®©tcpdumpæ‹¥æœ‰äº†"æ™ºèƒ½"
- è‡ªåŠ¨åŒ–æ˜¯ç½‘ç»œè¿ç»´çš„å¿…ç„¶è¶‹åŠ¿  
- å®Œå–„çš„é”™è¯¯å¤„ç†æ˜¯è„šæœ¬ç¨³å®šè¿è¡Œçš„ä¿éšœ
- æ€§èƒ½ä¼˜åŒ–å†³å®šäº†è„šæœ¬èƒ½å¦åœ¨ç”Ÿäº§ç¯å¢ƒé•¿æœŸè¿è¡Œ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> è„šæœ¬è‡ªåŠ¨æŠ“åŒ…å¿™ï¼Œå®šæ—¶è§¦å‘ä¸è¿·èŒ«  
> ç®¡é“å¤„ç†æ•°æ®å¼ºï¼Œæ—¥å¿—é”™è¯¯è¦è·Ÿä¸Š  
> æ€§èƒ½ä¼˜åŒ–æ˜¯å…³é”®ï¼Œè¿ç»´ç›‘æ§å±•ç¿…ç¿”