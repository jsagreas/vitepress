---
title: 12、挂载监控与故障排查工具
---
## 📚 目录

1. [挂载信息查看工具](#1-挂载信息查看工具)
2. [系统挂载状态监控](#2-系统挂载状态监控)
3. [挂载日志与内核消息](#3-挂载日志与内核消息)
4. [挂载故障排查流程](#4-挂载故障排查流程)
5. [实用排查技巧](#5-实用排查技巧)
6. [核心要点总结](#6-核心要点总结)

---

## 1. 🔍 挂载信息查看工具


### 1.1 /proc/mounts - 实时挂载信息


**💡 核心概念**
`/proc/mounts`是Linux内核提供的虚拟文件，记录了系统当前所有的挂载信息。这个文件是**实时更新**的，每当有挂载或卸载操作时，内容会立即改变。

> 📖 **生活类比**  
> 就像银行的实时账户余额，每笔交易都会立即反映在余额上，`/proc/mounts`也是这样实时反映挂载状态

**🔧 查看方法**
```bash
# 查看所有挂载信息
cat /proc/mounts

# 查看特定文件系统类型
grep "ext4" /proc/mounts

# 查看特定挂载点
grep "/home" /proc/mounts
```

**📋 输出格式解读**
```
设备名 挂载点 文件系统类型 挂载选项 dump频率 fsck顺序
```

**实例分析：**
```
/dev/sda1 / ext4 rw,relatime 0 0
/dev/sda2 /home ext4 rw,relatime 0 0
tmpfs /tmp tmpfs rw,nosuid,nodev 0 0
```

🔸 **第1列**：设备名（/dev/sda1）  
🔸 **第2列**：挂载点（/）  
🔸 **第3列**：文件系统类型（ext4）  
🔸 **第4列**：挂载选项（rw,relatime）  
🔸 **第5-6列**：备份和检查参数（通常为0）

### 1.2 /proc/filesystems - 支持的文件系统


**📚 作用说明**
这个文件列出了当前内核支持的所有文件系统类型，包括编译到内核中的和以模块形式加载的。

```bash
# 查看所有支持的文件系统
cat /proc/filesystems

# 查看是否支持特定文件系统
grep "ntfs" /proc/filesystems
```

**输出示例：**
```
nodev   sysfs
nodev   tmpfs
        ext2
        ext3
        ext4
nodev   devpts
        ntfs
        vfat
```

> 💡 **理解要点**  
> - **有nodev标记**：虚拟文件系统，不需要实际设备（如tmpfs、sysfs）
> - **无nodev标记**：需要实际设备的文件系统（如ext4、ntfs）

### 1.3 df命令 - 挂载点使用情况


**🎯 核心功能**
`df`（disk free）命令显示已挂载文件系统的磁盘空间使用情况，是最常用的存储监控工具。

**常用参数组合：**
```bash
# 人类可读格式显示
df -h

# 显示inode使用情况
df -i

# 显示文件系统类型
df -T

# 组合使用（推荐）
df -hT
```

**📊 输出解读示例：**
```
文件系统       类型   容量  已用  可用 使用% 挂载点
/dev/sda1      ext4    20G  15G  4.2G   79% /
/dev/sda2      ext4   100G  45G   50G   48% /home
tmpfs          tmpfs  2.0G     0  2.0G    0% /tmp
```

**🚨 重要提醒**
- **使用率超过80%**：需要关注，考虑清理
- **使用率超过90%**：高风险，需要立即处理
- **使用率100%**：系统可能出现异常

### 1.4 findmnt - 挂载关系树查看


**⭐ 现代化工具**
`findmnt`是较新的挂载信息查看工具，提供了树形结构显示，比传统工具更直观。

**基础用法：**
```bash
# 显示挂载树
findmnt

# 显示特定挂载点
findmnt /home

# JSON格式输出（便于脚本处理）
findmnt --json

# 显示设备大小信息
findmnt -D
```

**🌳 树形结构示例：**
```
TARGET                SOURCE      FSTYPE   OPTIONS
/                     /dev/sda1   ext4     rw,relatime
├─/home               /dev/sda2   ext4     rw,relatime
├─/tmp                tmpfs       tmpfs    rw,nosuid,nodev
├─/proc               proc        proc     rw,nosuid,nodev,noexec,relatime
└─/sys                sysfs       sysfs    rw,nosuid,nodev,noexec,relatime
```

> 🧠 **记忆技巧**  
> **findmnt** = **find** + **mount**，找到并显示挂载信息，记住它的树形结构特色

### 1.5 mountpoint - 验证挂载点


**🔧 精确验证工具**
`mountpoint`命令用于验证指定路径是否为挂载点，返回明确的是/否结果。

```bash
# 检查是否为挂载点
mountpoint /home

# 静默模式（只返回退出码）
mountpoint -q /home && echo "是挂载点" || echo "不是挂载点"

# 显示设备信息
mountpoint -d /home
```

**返回值含义：**
- **退出码0**：是挂载点
- **退出码1**：不是挂载点

---

## 2. 📊 系统挂载状态监控


### 2.1 实时监控挂载变化


**方法1：watch命令监控**
```bash
# 每2秒刷新挂载信息
watch -n 2 'df -h'

# 监控特定挂载点
watch -n 1 'mountpoint /media/usb && echo "已挂载" || echo "未挂载"'
```

**方法2：文件变化监控**
```bash
# 监控/proc/mounts变化
tail -f /proc/mounts
```

### 2.2 挂载点空间监控脚本


**🛠️ 实用监控脚本**
```bash
#!/bin/bash
# 挂载点空间使用率检查

check_disk_usage() {
    echo "=== 磁盘使用率检查 ==="
    df -h | awk '
    NR>1 && $5+0 > 80 {
        print "⚠️  警告: " $6 " 使用率 " $5 " (可用: " $4 ")"
    }
    NR>1 && $5+0 > 90 {
        print "🚨 严重: " $6 " 使用率 " $5 " 需立即处理!"
    }'
}

check_disk_usage
```

### 2.3 挂载状态健康检查


**核心检查项目：**

**✅ 基础检查清单**
- [ ] 所有预期挂载点是否正常挂载
- [ ] 磁盘使用率是否在安全范围
- [ ] 是否有只读挂载的异常情况
- [ ] 网络文件系统连接是否正常

**检查脚本示例：**
```bash
#!/bin/bash
# 挂载健康检查

echo "📋 挂载健康检查报告"
echo "===================="

# 检查关键挂载点
for mount_point in / /home /var /tmp; do
    if mountpoint -q "$mount_point"; then
        echo "✅ $mount_point 挂载正常"
    else
        echo "❌ $mount_point 挂载异常"
    fi
done

# 检查只读挂载
readonly_mounts=$(mount | grep " ro,")
if [ -n "$readonly_mounts" ]; then
    echo "⚠️  发现只读挂载:"
    echo "$readonly_mounts"
fi
```

---

## 3. 📝 挂载日志与内核消息


### 3.1 dmesg - 内核挂载消息


**💡 什么是dmesg**
`dmesg`显示内核环形缓冲区的消息，包含系统启动、硬件检测、挂载操作等重要信息。

> 📖 **生活类比**  
> `dmesg`就像汽车的行车记录仪，记录了系统运行过程中的重要事件

**查看挂载相关消息：**
```bash
# 查看所有内核消息
dmesg

# 过滤挂载相关消息
dmesg | grep -i mount

# 查看USB设备挂载信息
dmesg | grep -i usb

# 实时监控新消息
dmesg -w
```

**📋 常见挂载消息解读**
```bash
# 成功挂载
[  123.456] EXT4-fs (sda2): mounted filesystem with ordered data mode

# 挂载失败
[  123.456] EXT4-fs (sda3): bad geometry: block count exceeds size of device

# USB设备挂载
[  123.456] usb-storage 1-1:1.0: USB Mass Storage device detected
[  124.567] sd 2:0:0:0: [sdb] Attached SCSI removable disk
```

### 3.2 系统日志中的挂载信息


**日志文件位置：**
```bash
# 系统主日志
tail -f /var/log/messages

# Ubuntu/Debian系统日志
tail -f /var/log/syslog

# systemd日志
journalctl -u systemd-mount
```

**🔍 查看特定挂载操作日志**
```bash
# 查看今天的挂载相关日志
journalctl --since today | grep mount

# 查看特定设备的挂载历史
journalctl | grep sdb1
```

### 3.3 audit日志监控


对于需要严格监控的系统，可以启用audit来记录挂载操作：

```bash
# 添加挂载操作监控规则
auditctl -w /bin/mount -p x -k mount_commands

# 查看挂载操作审计日志
ausearch -k mount_commands
```

---

## 4. 🔧 挂载故障排查流程


### 4.1 系统化排查步骤


**📋 故障排查检查表**

**第一步：基础信息收集**
```bash
# 1. 查看当前挂载状态
df -hT
mount | column -t

# 2. 检查目标设备是否存在
lsblk
fdisk -l

# 3. 查看内核消息
dmesg | tail -20
```

**第二步：设备状态检查**
```bash
# 4. 检查设备健康状态
fsck -n /dev/sdb1  # 只读检查，不修复

# 5. 查看设备详细信息
blkid /dev/sdb1
file -s /dev/sdb1
```

**第三步：权限和路径检查**
```bash
# 6. 检查挂载点权限
ls -ld /mnt/mydisk

# 7. 确认挂载点为空
ls -la /mnt/mydisk

# 8. 检查用户权限
id  # 查看当前用户权限
```

### 4.2 常见故障现象与解决方案


**🚫 故障现象1：设备正忙(Device busy)**

**症状表现：**
```bash
umount: /mnt/mydisk: target is busy
```

**🔍 排查方法：**
```bash
# 查看哪些进程在使用该挂载点
lsof /mnt/mydisk
fuser -m /mnt/mydisk

# 强制结束使用该挂载点的进程
fuser -km /mnt/mydisk
```

**✅ 解决步骤：**
1. 切换到其他目录（不在挂载点内）
2. 结束使用该挂载点的进程
3. 重新尝试卸载

**🚫 故障现象2：权限被拒绝(Permission denied)**

**症状表现：**
```bash
mount: /mnt/mydisk: permission denied
```

**🔍 排查方法：**
```bash
# 检查用户权限
whoami
groups

# 检查挂载点权限
ls -ld /mnt/mydisk

# 检查设备权限
ls -l /dev/sdb1
```

**✅ 解决方案：**
- 使用`sudo`执行挂载命令
- 修改挂载点目录权限
- 将用户加入相应组

**🚫 故障现象3：文件系统损坏**

**症状表现：**
```bash
mount: wrong fs type, bad option, bad superblock
```

**🔍 排查与修复：**
```bash
# 检查文件系统类型
blkid /dev/sdb1

# 尝试修复文件系统
fsck -y /dev/sdb1  # 自动修复

# 如果无法修复，考虑数据恢复
testdisk /dev/sdb1
```

### 4.3 网络文件系统故障排查


**NFS挂载故障排查：**
```bash
# 检查NFS服务状态
systemctl status nfs-client
rpcinfo -p nfs-server-ip

# 测试网络连接
ping nfs-server-ip
telnet nfs-server-ip 2049

# 查看NFS导出列表
showmount -e nfs-server-ip
```

**CIFS/SMB挂载故障排查：**
```bash
# 测试SMB连接
smbclient -L server-ip -U username

# 检查认证信息
mount -t cifs //server/share /mnt/smb -o username=user,password=pass -v
```

---

## 5. 💡 实用排查技巧


### 5.1 快速诊断命令组合


**🚀 一键检查脚本**
```bash
#!/bin/bash
# 挂载状态快速检查

echo "🔍 系统挂载状态检查"
echo "====================="

echo "📊 磁盘使用情况:"
df -hT | head -1 && df -hT | grep -v tmpfs | grep -v udev

echo -e "\n🌳 挂载关系树:"
findmnt --df | head -10

echo -e "\n⚠️  近期内核消息:"
dmesg | grep -i "mount\|usb\|sd" | tail -5

echo -e "\n📝 系统负载:"
uptime
```

### 5.2 性能监控技巧


**I/O性能监控：**
```bash
# 实时监控磁盘I/O
iostat -x 1

# 查看进程I/O使用情况
iotop
```

**挂载点容量趋势：**
```bash
# 创建简单的容量监控
echo "$(date): $(df -h / | tail -1)" >> /var/log/disk_usage.log
```

### 5.3 预防性维护


**📋 定期维护检查清单**

**🔸 每日检查**
- [ ] `df -h` 检查磁盘使用率
- [ ] `dmesg | tail` 检查内核消息
- [ ] 关键挂载点可访问性测试

**🔸 每周检查**
- [ ] `fsck -n` 文件系统只读检查
- [ ] 备份重要数据
- [ ] 清理临时文件和日志

**🔸 每月检查**
- [ ] 硬盘健康状态检查（`smartctl`）
- [ ] 挂载配置文件备份
- [ ] 系统性能趋势分析

### 5.4 应急处理预案


**🚨 紧急情况处理方案**

**情况1：根分区空间不足**
```bash
# 紧急清理方案
# 清理临时文件
rm -rf /tmp/*
# 清理日志文件
> /var/log/messages
# 清理包缓存
apt clean  # Ubuntu/Debian
yum clean all  # CentOS/RHEL
```

**情况2：关键挂载点失效**
```bash
# 应急重新挂载
mount -o remount,rw /
# 或强制挂载
mount -o force /dev/sdb1 /mnt/backup
```

---

## 6. 📋 核心要点总结


### 6.1 必须掌握的核心工具


```
🔸 /proc/mounts：实时挂载信息，最准确的当前状态
🔸 df -hT：磁盘使用情况，日常监控必备
🔸 findmnt：现代化挂载树查看工具
🔸 dmesg：内核消息，故障排查的关键信息源
🔸 mountpoint：快速验证挂载点状态
```

### 6.2 关键排查思路


**🔹 故障排查三步法**
```
第一步：信息收集
• 查看当前挂载状态（df、mount、findmnt）
• 检查设备状态（lsblk、blkid）
• 查看系统日志（dmesg、journalctl）

第二步：问题定位
• 设备是否存在和可访问
• 文件系统是否损坏
• 权限是否正确
• 是否有进程占用

第三步：解决方案
• 修复文件系统错误
• 调整权限设置
• 结束占用进程
• 重新挂载或修改配置
```

**🔹 预防为主的监控策略**
```
日常监控：
• 定期检查磁盘使用率（避免100%满载）
• 关注内核消息中的异常信息
• 监控文件系统健康状态

预防措施：
• 设置磁盘使用率告警
• 定期备份重要数据
• 建立标准的维护流程
```

### 6.3 实用记忆口诀


**🧠 核心记忆要点**
- **proc/mounts最实时，df命令看空间**
- **findmnt显示树，dmesg查内核**  
- **故障排查三步走，信息定位再解决**
- **预防监控要及时，空间满了系统卡**

**🎯 关键命令记忆**
- **查看挂载**：`df -hT`、`findmnt`、`mount`
- **设备检查**：`lsblk`、`blkid`、`fsck -n`
- **故障排查**：`dmesg`、`lsof`、`fuser`
- **状态验证**：`mountpoint`、`journalctl`

### 6.4 实际应用价值


**📈 运维价值**
- **故障预防**：通过监控及早发现问题
- **快速定位**：系统化的排查流程缩短故障时间
- **数据保护**：预防性维护减少数据丢失风险
- **性能优化**：监控磁盘使用情况，优化存储配置

**🛠️ 学习建议**
- **多实践**：在虚拟机中模拟各种故障场景
- **建立习惯**：养成定期检查系统状态的习惯
- **记录总结**：记录遇到的问题和解决方案
- **关注日志**：培养从日志中找线索的能力

**核心理念**：挂载监控不是出问题后的被动处理，而是日常运维中的主动预防和持续监控。