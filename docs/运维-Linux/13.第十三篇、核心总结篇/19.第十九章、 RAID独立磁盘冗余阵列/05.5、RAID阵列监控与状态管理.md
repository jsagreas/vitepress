---
title: 5ã€RAIDé˜µåˆ—ç›‘æ§ä¸çŠ¶æ€ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [RAIDç›‘æ§æ¦‚è¿°](#1-RAIDç›‘æ§æ¦‚è¿°)
2. [mdadmè¯¦ç»†ä¿¡æ¯æŸ¥çœ‹](#2-mdadmè¯¦ç»†ä¿¡æ¯æŸ¥çœ‹)
3. [å®æ—¶çŠ¶æ€ç›‘æ§](#3-å®æ—¶çŠ¶æ€ç›‘æ§)
4. [é˜µåˆ—å¥åº·çŠ¶æ€æ£€æŸ¥](#4-é˜µåˆ—å¥åº·çŠ¶æ€æ£€æŸ¥)
5. [é‡å»ºä¸æ ¡éªŒç®¡ç†](#5-é‡å»ºä¸æ ¡éªŒç®¡ç†)
6. [é”™è¯¯åˆ†æä¸å¤„ç†](#6-é”™è¯¯åˆ†æä¸å¤„ç†)
7. [æ€§èƒ½ç›‘æ§ä¼˜åŒ–](#7-æ€§èƒ½ç›‘æ§ä¼˜åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“Š RAIDç›‘æ§æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦RAIDç›‘æ§


**ç®€å•ç†è§£**ï¼šRAIDç›‘æ§å°±åƒæ˜¯ç»™ä½ çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿè£…äº†ä¸€ä¸ª"ä½“æ£€ä»ª"

```
ç°å®ç±»æ¯”ï¼š
æ±½è½¦ä»ªè¡¨ç›˜ â†’ æ˜¾ç¤ºé€Ÿåº¦ã€æ²¹é‡ã€æ¸©åº¦
RAIDç›‘æ§ â†’ æ˜¾ç¤ºç£ç›˜çŠ¶æ€ã€åŒæ­¥è¿›åº¦ã€é”™è¯¯ä¿¡æ¯

ä½œç”¨ï¼š
ğŸ” åŠæ—¶å‘ç°é—®é¢˜ï¼šç£ç›˜æ•…éšœã€æ€§èƒ½ä¸‹é™
âš¡ é¢„é˜²æ•°æ®ä¸¢å¤±ï¼šåœ¨å½»åº•æŸåå‰æ›´æ¢æ•…éšœç›˜
ğŸ“ˆ ä¼˜åŒ–æ€§èƒ½ï¼šç›‘æ§è¯»å†™é€Ÿåº¦ï¼Œè°ƒæ•´å‚æ•°
```

### 1.2 ç›‘æ§çš„æ ¸å¿ƒè¦ç´ 


**ğŸ”¥ å¿…é¡»å…³æ³¨çš„ä¿¡æ¯**
- **ç£ç›˜çŠ¶æ€**ï¼šæ˜¯å¦æ­£å¸¸å·¥ä½œ
- **é˜µåˆ—çŠ¶æ€**ï¼šæ˜¯å¦åœ¨é‡å»ºã€åŒæ­¥
- **é”™è¯¯è®¡æ•°**ï¼šæœ‰å¤šå°‘è¯»å†™é”™è¯¯
- **æ€§èƒ½æŒ‡æ ‡**ï¼šè¯»å†™é€Ÿåº¦å¦‚ä½•

### 1.3 ç›‘æ§å·¥å…·å…¨æ™¯å›¾


```
Linux RAIDç›‘æ§å·¥å…·ä½“ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç›‘æ§å±‚æ¬¡                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨å±‚  â”‚ iostat, iotop         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç³»ç»Ÿå±‚  â”‚ /proc/mdstat         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç®¡ç†å±‚  â”‚ mdadm --detail       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¡¬ä»¶å±‚  â”‚ smartctl, hdparm     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ” mdadmè¯¦ç»†ä¿¡æ¯æŸ¥çœ‹


### 2.1 åŸºæœ¬ä¿¡æ¯æŸ¥çœ‹


**â­â­â­ æœ€å¸¸ç”¨å‘½ä»¤**ï¼š`mdadm --detail`

```bash
# æŸ¥çœ‹RAIDé˜µåˆ—è¯¦ç»†ä¿¡æ¯
mdadm --detail /dev/md0
```

**å…¸å‹è¾“å‡ºè§£è¯»**ï¼š
```
/dev/md0:
        Version : 1.2                    â† å…ƒæ•°æ®ç‰ˆæœ¬
  Creation Time : Wed Sep 19 10:30:15 2025  â† åˆ›å»ºæ—¶é—´
     Raid Level : raid5                 â† RAIDç±»å‹
     Array Size : 2097152 (2048.00 MiB) â† é˜µåˆ—å¤§å°
  Used Dev Size : 1048576 (1024.00 MiB) â† å•ç›˜ä½¿ç”¨å¤§å°
   Raid Devices : 3                     â† RAIDè®¾å¤‡æ•°é‡
  Total Devices : 3                     â† æ€»è®¾å¤‡æ•°é‡
    Persistence : Superblock is persistent
    Update Time : Wed Sep 19 15:45:20 2025  â† æœ€åæ›´æ–°æ—¶é—´
          State : clean                  â† ğŸŸ¢ é˜µåˆ—çŠ¶æ€ï¼ˆé‡è¦ï¼ï¼‰
 Active Devices : 3                     â† æ´»è·ƒè®¾å¤‡æ•°
Working Devices : 3                     â† å·¥ä½œè®¾å¤‡æ•°
 Failed Devices : 0                     â† ğŸ”´ æ•…éšœè®¾å¤‡æ•°ï¼ˆå…³é”®ï¼ï¼‰
  Spare Devices : 0                     â† å¤‡ç”¨è®¾å¤‡æ•°
```

### 2.2 çŠ¶æ€å­—æ®µè¯¦è§£


**ğŸ¯ å…³é”®çŠ¶æ€è¯´æ˜**

| çŠ¶æ€ | å«ä¹‰ | ä¸¥é‡ç¨‹åº¦ | å¤„ç†å»ºè®® |
|------|------|----------|----------|
| **clean** | `é˜µåˆ—æ­£å¸¸ï¼Œæ‰€æœ‰æ“ä½œå®Œæˆ` | ğŸŸ¢ æ­£å¸¸ | `æ— éœ€å¤„ç†` |
| **active** | `é˜µåˆ—å·¥ä½œä¸­ï¼Œå¯èƒ½åœ¨åŒæ­¥` | ğŸŸ¡ æ³¨æ„ | `è§‚å¯Ÿè¿›åº¦` |
| **degraded** | `æœ‰ç£ç›˜æ•…éšœï¼Œä½†ä»å¯ç”¨` | ğŸŸ  è­¦å‘Š | `å°½å¿«æ›´æ¢æ•…éšœç›˜` |
| **failed** | `é˜µåˆ—å¤±æ•ˆï¼Œæ•°æ®æœ‰é£é™©` | ğŸ”´ ä¸¥é‡ | `ç«‹å³å¤„ç†æˆ–æ¢å¤å¤‡ä»½` |
| **resyncing** | `æ­£åœ¨é‡å»ºæˆ–åŒæ­¥æ•°æ®` | ğŸŸ¡ æ³¨æ„ | `ç­‰å¾…å®Œæˆï¼Œé¿å…é‡å¯` |

### 2.3 è®¾å¤‡åˆ—è¡¨ä¿¡æ¯


**ğŸ“‹ ç†è§£è®¾å¤‡çŠ¶æ€**
```
    Number   Major   Minor   RaidDevice State
       0       8        1        0      active sync   /dev/sdb1
       1       8       17        1      active sync   /dev/sdc1  
       2       8       33        2      active sync   /dev/sdd1
```

**å­—æ®µå«ä¹‰**ï¼š
- **Number**ï¼šè®¾å¤‡åœ¨é˜µåˆ—ä¸­çš„ç¼–å·
- **RaidDevice**ï¼šé€»è¾‘ä½ç½®ç¼–å·
- **State**ï¼šè®¾å¤‡çŠ¶æ€
  - `active sync`ï¼šğŸŸ¢ æ­£å¸¸å·¥ä½œå¹¶åŒæ­¥
  - `spare`ï¼šğŸŸ¡ çƒ­å¤‡ç›˜
  - `faulty`ï¼šğŸ”´ æ•…éšœçŠ¶æ€

### 2.4 å¿«é€ŸçŠ¶æ€æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# RAIDå¿«é€Ÿå¥åº·æ£€æŸ¥è„šæœ¬

echo "=== RAIDé˜µåˆ—çŠ¶æ€æ¦‚è§ˆ ==="
for md in /dev/md*; do
    if [ -b "$md" ]; then
        echo "æ£€æŸ¥ $md:"
        state=$(mdadm --detail $md | grep "State :" | awk '{print $3}')
        failed=$(mdadm --detail $md | grep "Failed Devices" | awk '{print $4}')
        
        if [ "$state" = "clean" ] && [ "$failed" = "0" ]; then
            echo "  âœ… çŠ¶æ€æ­£å¸¸"
        else
            echo "  âš ï¸  çŠ¶æ€: $state, æ•…éšœè®¾å¤‡: $failed"
        fi
    fi
done
```

---

## 3. ğŸ“ˆ å®æ—¶çŠ¶æ€ç›‘æ§


### 3.1 /proc/mdstat æ ¸å¿ƒç›‘æ§


**ğŸ’¡ ä»€ä¹ˆæ˜¯ /proc/mdstat**
è¿™æ˜¯Linuxå†…æ ¸æä¾›çš„å®æ—¶RAIDçŠ¶æ€æ–‡ä»¶ï¼Œå°±åƒç³»ç»Ÿçš„"å®æ—¶ä»ªè¡¨ç›˜"

```bash
# å®æ—¶æŸ¥çœ‹RAIDçŠ¶æ€
cat /proc/mdstat

# æŒç»­ç›‘æ§ï¼ˆæ¯2ç§’åˆ·æ–°ä¸€æ¬¡ï¼‰
watch -n 2 cat /proc/mdstat
```

### 3.2 /proc/mdstat è¾“å‡ºè§£è¯»


**å…¸å‹è¾“å‡ºç¤ºä¾‹**ï¼š
```
Personalities : [raid1] [raid5] [raid6] [raid10]
md0 : active raid5 sdd1[2] sdc1[1] sdb1[0]
      2097152 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/3] [UUU]
      
md1 : active raid1 sdf1[1] sde1[0]
      1048576 blocks super 1.2 [2/2] [UU]
      resync=DELAYED
      
unused devices: <none>
```

**é€è¡Œè§£é‡Š**ï¼š

**ç¬¬1è¡Œ**ï¼š`Personalities : [raid1] [raid5] [raid6] [raid10]`
- ç³»ç»Ÿæ”¯æŒçš„RAIDç±»å‹

**ç¬¬2-3è¡Œ**ï¼š`md0 : active raid5 sdd1[2] sdc1[1] sdb1[0]`
- `md0`ï¼šè®¾å¤‡åç§°  
- `active`ï¼šğŸŸ¢ é˜µåˆ—çŠ¶æ€ï¼ˆactive=å·¥ä½œä¸­ï¼‰
- `raid5`ï¼šRAIDç±»å‹
- `sdd1[2]`ï¼šè®¾å¤‡sdd1ï¼Œç¼–å·ä¸º2

**å…³é”®ä¿¡æ¯**ï¼š`[3/3] [UUU]`
- `[3/3]`ï¼šæ€»å…±3ä¸ªè®¾å¤‡ï¼Œ3ä¸ªæ­£å¸¸å·¥ä½œ
- `[UUU]`ï¼šæ¯ä¸ªUä»£è¡¨ä¸€ä¸ªæ­£å¸¸è®¾å¤‡ï¼Œå¦‚æœæ˜¯`[UU_]`è¡¨ç¤ºç¬¬3ä¸ªè®¾å¤‡æ•…éšœ

### 3.3 åŒæ­¥è¿›åº¦ç›‘æ§


**é‡å»º/åŒæ­¥æ—¶çš„æ˜¾ç¤º**ï¼š
```
md0 : active raid5 sdd1[2] sdc1[1] sdb1[0]
      2097152 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/3] [UUU]
      [>....................]  resync =  1.2% (25600/2097152) finish=8.5min speed=4096K/sec
```

**è¿›åº¦ä¿¡æ¯è§£è¯»**ï¼š
- `resync = 1.2%`ï¼šå½“å‰å®Œæˆç™¾åˆ†æ¯”
- `(25600/2097152)`ï¼šå·²å®Œæˆ/æ€»é‡ï¼ˆå•ä½ï¼šKBï¼‰
- `finish=8.5min`ï¼šé¢„è®¡å‰©ä½™æ—¶é—´
- `speed=4096K/sec`ï¼šå½“å‰åŒæ­¥é€Ÿåº¦

### 3.4 ç›‘æ§è„šæœ¬ç¤ºä¾‹


```bash
#!/bin/bash
# RAIDå®æ—¶ç›‘æ§è„šæœ¬

monitor_raid() {
    while true; do
        clear
        echo "=== RAID å®æ—¶ç›‘æ§ $(date) ==="
        echo
        
        # æ˜¾ç¤ºæ‰€æœ‰RAIDçŠ¶æ€
        cat /proc/mdstat
        echo
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œ
        if grep -q "resync\|recovery\|check" /proc/mdstat; then
            echo "ğŸ”„ æ£€æµ‹åˆ°æ­£åœ¨è¿›è¡Œçš„æ“ä½œï¼Œè¯¦ç»†ä¿¡æ¯ï¼š"
            grep -A1 -B1 "resync\|recovery\|check" /proc/mdstat
        else
            echo "âœ… æ‰€æœ‰é˜µåˆ—çŠ¶æ€ç¨³å®š"
        fi
        
        sleep 5
    done
}

# å¯åŠ¨ç›‘æ§
monitor_raid
```

---

## 4. ğŸ¥ é˜µåˆ—å¥åº·çŠ¶æ€æ£€æŸ¥


### 4.1 å¥åº·çŠ¶æ€ç­‰çº§


**ğŸ¯ RAIDå¥åº·çŠ¶æ€åˆ†çº§**

```
å¥åº·çŠ¶æ€å±‚æ¬¡ï¼š
ğŸŸ¢ å®Œå…¨å¥åº· â†’ æ‰€æœ‰è®¾å¤‡æ­£å¸¸ï¼Œæ— é”™è¯¯
ğŸŸ¡ è½»å¾®é—®é¢˜ â†’ å¶å‘é”™è¯¯ï¼Œä½†åœ¨å®¹å¿èŒƒå›´å†…  
ğŸŸ  éœ€è¦æ³¨æ„ â†’ é”™è¯¯å¢å¤šæˆ–æœ‰è®¾å¤‡ä¸ç¨³å®š
ğŸ”´ ä¸¥é‡è­¦å‘Š â†’ è®¾å¤‡æ•…éšœæˆ–é˜µåˆ—é™çº§
âš« å®Œå…¨å¤±æ•ˆ â†’ é˜µåˆ—æ— æ³•å·¥ä½œ
```

### 4.2 å…¨é¢å¥åº·æ£€æŸ¥


**å®Œæ•´æ£€æŸ¥å‘½ä»¤ç»„åˆ**ï¼š

```bash
# 1. åŸºæœ¬çŠ¶æ€æ£€æŸ¥
echo "=== åŸºæœ¬RAIDçŠ¶æ€ ==="
cat /proc/mdstat

# 2. è¯¦ç»†ä¿¡æ¯æ£€æŸ¥  
echo "=== è¯¦ç»†é˜µåˆ—ä¿¡æ¯ ==="
for md in /dev/md*; do
    [ -b "$md" ] && mdadm --detail "$md"
done

# 3. ç£ç›˜SMARTä¿¡æ¯æ£€æŸ¥
echo "=== ç£ç›˜å¥åº·çŠ¶æ€ ==="
for disk in /dev/sd[a-z]; do
    [ -b "$disk" ] && smartctl -H "$disk" 2>/dev/null
done
```

### 4.3 é”™è¯¯æ¨¡å¼è¯†åˆ«


**ğŸš¨ å¸¸è§é—®é¢˜æ¨¡å¼**

| ç—‡çŠ¶ | å¯èƒ½åŸå›  | å¤„ç†å»ºè®® |
|------|----------|----------|
| **é¢‘ç¹é‡å»º** | `ç£ç›˜ä¸ç¨³å®šæˆ–ç”µæºé—®é¢˜` | `æ£€æŸ¥ç¡¬ä»¶è¿æ¥ï¼Œæ›´æ¢å¯ç–‘ç£ç›˜` |
| **åŒæ­¥é€Ÿåº¦å¾ˆæ…¢** | `ç£ç›˜æ€§èƒ½ä¸‹é™æˆ–ç³»ç»Ÿè´Ÿè½½é«˜` | `æ£€æŸ¥ç£ç›˜å¥åº·ï¼Œè°ƒæ•´åŒæ­¥é€Ÿåº¦` |
| **é”™è¯¯æ•°æŒç»­å¢é•¿** | `ç£ç›˜å¼€å§‹è€åŒ–æˆ–æœ‰åé“` | `å¤‡ä»½æ•°æ®ï¼Œå‡†å¤‡æ›´æ¢ç£ç›˜` |
| **é˜µåˆ—æ— æ³•å¯åŠ¨** | `å…ƒæ•°æ®æŸåæˆ–é…ç½®é”™è¯¯` | `æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼Œå°è¯•å¼ºåˆ¶ç»„è£…` |

### 4.4 é¢„è­¦é˜ˆå€¼è®¾ç½®


**å»ºè®®çš„ç›‘æ§é˜ˆå€¼**ï¼š
```bash
# åœ¨ç›‘æ§è„šæœ¬ä¸­è®¾ç½®é¢„è­¦é˜ˆå€¼
DEGRADED_WARNING=1     # å…è®¸1ä¸ªç£ç›˜æ•…éšœ
ERROR_THRESHOLD=10     # é”™è¯¯æ•°è¶…è¿‡10ä¸ªæŠ¥è­¦
SYNC_SPEED_MIN=1000    # åŒæ­¥é€Ÿåº¦ä½äº1MB/sæŠ¥è­¦
TEMP_THRESHOLD=50      # ç£ç›˜æ¸©åº¦è¶…è¿‡50Â°CæŠ¥è­¦
```

---

## 5. ğŸ”§ é‡å»ºä¸æ ¡éªŒç®¡ç†


### 5.1 é‡å»º(Rebuild)è¿‡ç¨‹ç®¡ç†


**ğŸ’¡ ä»€ä¹ˆæ˜¯é‡å»º**
å½“RAIDé˜µåˆ—ä¸­æœ‰ç£ç›˜æ•…éšœè¢«æ›¿æ¢æ—¶ï¼Œæ–°ç£ç›˜éœ€è¦"é‡å»º"æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«rebuild

```
é‡å»ºè¿‡ç¨‹ç¤ºæ„ï¼š
æ•…éšœå‰: [ç›˜A] [ç›˜B] [ç›˜C] - æ­£å¸¸å·¥ä½œ
æ•…éšœå: [ç›˜A] [ç›˜B] [æ•…éšœ] - é™çº§æ¨¡å¼  
æ›¿æ¢å: [ç›˜A] [ç›˜B] [æ–°ç›˜] - å¼€å§‹é‡å»º
é‡å»ºä¸­: [ç›˜A] [ç›˜B] [æ–°ç›˜] - æ•°æ®æ¢å¤ä¸­...
å®Œæˆå: [ç›˜A] [ç›˜B] [æ–°ç›˜] - æ¢å¤æ­£å¸¸
```

### 5.2 é‡å»ºè¿›åº¦ç›‘æ§


**å®æ—¶ç›‘æ§é‡å»ºè¿›åº¦**ï¼š
```bash
# æ–¹æ³•1ï¼šæŸ¥çœ‹ /proc/mdstat
watch -n 10 'cat /proc/mdstat | grep -A2 rebuild'

# æ–¹æ³•2ï¼šè¯¦ç»†è¿›åº¦ä¿¡æ¯
watch -n 30 'mdadm --detail /dev/md0 | grep -E "State|Rebuild"'
```

**é‡å»ºæœŸé—´çš„æ³¨æ„äº‹é¡¹**ï¼š
> âš ï¸ **é‡è¦æé†’**ï¼šé‡å»ºæœŸé—´é¿å…é‡å¯ç³»ç»Ÿ
> ğŸ’¡ **å°è´´å£«**ï¼šå¯ä»¥è°ƒæ•´é‡å»ºé€Ÿåº¦ä»¥å¹³è¡¡æ€§èƒ½
> ğŸš¨ **è­¦å‘Š**ï¼šé‡å»ºæœŸé—´æ•°æ®å†—ä½™åº¦é™ä½ï¼Œè¦ç‰¹åˆ«å°å¿ƒ

### 5.3 è°ƒæ•´é‡å»ºé€Ÿåº¦


**ä¸ºä»€ä¹ˆè¦è°ƒæ•´é‡å»ºé€Ÿåº¦**
- å¤ªå¿«ï¼šå½±å“æ­£å¸¸ä¸šåŠ¡æ€§èƒ½
- å¤ªæ…¢ï¼šå»¶é•¿é£é™©æš´éœ²æ—¶é—´

```bash
# æŸ¥çœ‹å½“å‰é‡å»ºé€Ÿåº¦é™åˆ¶
cat /proc/sys/dev/raid/speed_limit_min
cat /proc/sys/dev/raid/speed_limit_max

# è°ƒæ•´é‡å»ºé€Ÿåº¦ï¼ˆå•ä½ï¼šKB/sï¼‰
echo 10000 > /proc/sys/dev/raid/speed_limit_min  # æœ€ä½10MB/s
echo 100000 > /proc/sys/dev/raid/speed_limit_max # æœ€é«˜100MB/s

# ä¸´æ—¶æé«˜é‡å»ºä¼˜å…ˆçº§
echo 100000 > /sys/block/md0/md/sync_speed_min
```

### 5.4 æ ¡éªŒ(Check)æ“ä½œ


**ğŸ’¡ ä»€ä¹ˆæ˜¯æ ¡éªŒ**
å®šæœŸæ£€æŸ¥RAIDæ•°æ®ä¸€è‡´æ€§ï¼Œç¡®ä¿æ²¡æœ‰é™é»˜é”™è¯¯

```bash
# å¯åŠ¨æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ
echo check > /sys/block/md0/md/sync_action

# æŸ¥çœ‹æ ¡éªŒè¿›åº¦
cat /proc/mdstat

# æŸ¥çœ‹æ ¡éªŒç»“æœï¼ˆé”™è¯¯æ•°é‡ï¼‰
cat /sys/block/md0/md/mismatch_cnt
```

**æ ¡éªŒè°ƒåº¦å»ºè®®**ï¼š
```bash
# è®¾ç½®å®šæœŸæ ¡éªŒï¼ˆæ¯æœˆç¬¬ä¸€ä¸ªå‘¨æ—¥å‡Œæ™¨2ç‚¹ï¼‰
echo "0 2 * * 0 [ \$(date +\%d) -le 7 ] && echo check > /sys/block/md0/md/sync_action" >> /etc/crontab
```

---

## 6. ğŸ“Š é”™è¯¯åˆ†æä¸å¤„ç†


### 6.1 é”™è¯¯ç±»å‹åˆ†æ


**RAIDé”™è¯¯åˆ†ç±»**ï¼š

```
é”™è¯¯ç±»å‹å±‚æ¬¡å›¾ï¼š
é”™è¯¯
â”œâ”€â”€ ç¡¬ä»¶é”™è¯¯
â”‚   â”œâ”€â”€ ç£ç›˜æ•…éšœï¼ˆbad sectorsï¼‰
â”‚   â”œâ”€â”€ è¿æ¥é—®é¢˜ï¼ˆcable/controllerï¼‰
â”‚   â””â”€â”€ ç”µæºé—®é¢˜ï¼ˆpower fluctuationï¼‰
â”œâ”€â”€ è½¯ä»¶é”™è¯¯  
â”‚   â”œâ”€â”€ é©±åŠ¨é—®é¢˜ï¼ˆdriver bugsï¼‰
â”‚   â”œâ”€â”€ æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ï¼ˆfilesystem corruptionï¼‰
â”‚   â””â”€â”€ é…ç½®é”™è¯¯ï¼ˆconfiguration mistakesï¼‰
â””â”€â”€ ç¯å¢ƒé”™è¯¯
    â”œâ”€â”€ æ¸©åº¦è¿‡é«˜ï¼ˆoverheatingï¼‰
    â”œâ”€â”€ æŒ¯åŠ¨å¹²æ‰°ï¼ˆvibrationï¼‰
    â””â”€â”€ ç”µç£å¹²æ‰°ï¼ˆEMIï¼‰
```

### 6.2 é”™è¯¯ä¿¡æ¯æ”¶é›†


**ç³»ç»Ÿæ—¥å¿—åˆ†æ**ï¼š
```bash
# æŸ¥çœ‹RAIDç›¸å…³é”™è¯¯æ—¥å¿—
dmesg | grep -i "raid\|md\|error" | tail -20

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„å­˜å‚¨é”™è¯¯
grep -i "error\|fail" /var/log/messages | grep -E "sd[a-z]|md"

# æŸ¥çœ‹ç¡¬ä»¶é”™è¯¯ç»Ÿè®¡
cat /sys/block/sda/stat
```

### 6.3 é”™è¯¯ç»Ÿè®¡åˆ†æ


**mdadmé”™è¯¯ç»Ÿè®¡**ï¼š
```bash
# æŸ¥çœ‹æ¯ä¸ªè®¾å¤‡çš„é”™è¯¯è®¡æ•°
for md in /dev/md*; do
    if [ -b "$md" ]; then
        echo "=== $md é”™è¯¯ç»Ÿè®¡ ==="
        mdadm --detail "$md" | grep -E "Events|Errors"
    fi
done
```

**SMARTé”™è¯¯æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥ç£ç›˜SMARTé”™è¯¯
for disk in /dev/sd[a-z]; do
    if [ -b "$disk" ]; then
        echo "=== $disk SMARTçŠ¶æ€ ==="
        smartctl -l error "$disk" | head -10
    fi
done
```

### 6.4 æ•…éšœå¤„ç†æµç¨‹


**ğŸ”„ æ ‡å‡†æ•…éšœå¤„ç†æ­¥éª¤**ï¼š

```
æ•…éšœå¤„ç†æµç¨‹ï¼š
1. å‘ç°é—®é¢˜ â†’ ç›‘æ§æŠ¥è­¦æˆ–å®šæœŸæ£€æŸ¥
2. ç¡®è®¤æ•…éšœ â†’ åˆ†ææ—¥å¿—å’ŒçŠ¶æ€ä¿¡æ¯  
3. éš”ç¦»å½±å“ â†’ æ ‡è®°æ•…éšœè®¾å¤‡ï¼Œé˜²æ­¢æ‰©æ•£
4. æ›´æ¢ç¡¬ä»¶ â†’ ç‰©ç†æ›´æ¢æ•…éšœç£ç›˜
5. é‡å»ºæ•°æ® â†’ å¯åŠ¨rebuildè¿‡ç¨‹
6. éªŒè¯ä¿®å¤ â†’ æ ¡éªŒæ•°æ®å®Œæ•´æ€§
7. ç›‘æ§è§‚å¯Ÿ â†’ æŒç»­è§‚å¯Ÿä¸€æ®µæ—¶é—´
```

**æ•…éšœè®¾å¤‡ç§»é™¤ç¤ºä¾‹**ï¼š
```bash
# 1. æ ‡è®°æ•…éšœè®¾å¤‡
mdadm --manage /dev/md0 --fail /dev/sdb1

# 2. ä»é˜µåˆ—ä¸­ç§»é™¤
mdadm --manage /dev/md0 --remove /dev/sdb1

# 3. æ·»åŠ æ–°è®¾å¤‡
mdadm --manage /dev/md0 --add /dev/sdb1

# 4. ç›‘æ§é‡å»ºè¿›ç¨‹
watch cat /proc/mdstat
```

---

## 7. âš¡ æ€§èƒ½ç›‘æ§ä¼˜åŒ–


### 7.1 æ€§èƒ½ç›‘æ§æŒ‡æ ‡


**ğŸ¯ å…³é”®æ€§èƒ½æŒ‡æ ‡**

| æŒ‡æ ‡ | å«ä¹‰ | æ­£å¸¸èŒƒå›´ | ç›‘æ§æ–¹æ³• |
|------|------|----------|----------|
| **IOPS** | `æ¯ç§’è¾“å…¥è¾“å‡ºæ“ä½œæ•°` | `ä¾ç¡¬ä»¶è€Œå®š` | `iostat -x 1` |
| **ååé‡** | `æ¯ç§’ä¼ è¾“æ•°æ®é‡` | `æ¥è¿‘ç¡¬ä»¶ä¸Šé™` | `iotop -a` |
| **å»¶è¿Ÿ** | `è¯·æ±‚å“åº”æ—¶é—´` | `<10ms(SSD)` | `iostat -x 1` |
| **é˜Ÿåˆ—æ·±åº¦** | `ç­‰å¾…å¤„ç†çš„è¯·æ±‚æ•°` | `<32` | `iostat -x 1` |

### 7.2 å®æ—¶æ€§èƒ½ç›‘æ§


**åŸºç¡€æ€§èƒ½ç›‘æ§å‘½ä»¤**ï¼š
```bash
# 1. æŸ¥çœ‹ç£ç›˜I/Oç»Ÿè®¡
iostat -x 1 5

# 2. æŸ¥çœ‹è¿›ç¨‹I/Oä½¿ç”¨æƒ…å†µ  
iotop -o -d 1

# 3. æŸ¥çœ‹RAIDè®¾å¤‡æ€§èƒ½
iostat -x 1 | grep md

# 4. æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“I/O
vmstat 1 5
```

### 7.3 æ€§èƒ½è°ƒä¼˜å‚æ•°


**é‡è¦è°ƒä¼˜å‚æ•°**ï¼š
```bash
# 1. è°ƒæ•´é¢„è¯»ç¼“å­˜å¤§å°
echo 8192 > /sys/block/md0/queue/read_ahead_kb

# 2. è°ƒæ•´è°ƒåº¦ç®—æ³•ï¼ˆSSDç”¨none/noopï¼Œæœºæ¢°ç›˜ç”¨cfqï¼‰
echo deadline > /sys/block/md0/queue/scheduler

# 3. è°ƒæ•´æ¡å¸¦ç¼“å­˜å¤§å°ï¼ˆä»…RAID4/5/6ï¼‰
echo 16384 > /sys/block/md0/md/stripe_cache_size

# 4. è°ƒæ•´é‡å»ºé€Ÿåº¦é™åˆ¶
echo 50000 > /proc/sys/dev/raid/speed_limit_min
echo 200000 > /proc/sys/dev/raid/speed_limit_max
```

### 7.4 æ€§èƒ½ç›‘æ§è„šæœ¬


```bash
#!/bin/bash
# RAIDæ€§èƒ½ç›‘æ§è„šæœ¬

echo "=== RAIDæ€§èƒ½ç›‘æ§æŠ¥å‘Š $(date) ==="

# è·å–RAIDè®¾å¤‡åˆ—è¡¨
raid_devices=$(ls /dev/md* 2>/dev/null)

for md in $raid_devices; do
    if [ -b "$md" ]; then
        device=$(basename $md)
        echo
        echo "--- $device æ€§èƒ½æŒ‡æ ‡ ---"
        
        # å½“å‰I/Oç»Ÿè®¡
        iostat -x 1 2 | grep $device | tail -1 | \
        awk '{printf "è¯»é€Ÿåº¦: %6.2f MB/s, å†™é€Ÿåº¦: %6.2f MB/s, åˆ©ç”¨ç‡: %5.1f%%\n", 
              $6/1024, $7/1024, $10}'
        
        # é˜Ÿåˆ—æ·±åº¦å’Œå»¶è¿Ÿ
        iostat -x 1 2 | grep $device | tail -1 | \
        awk '{printf "é˜Ÿåˆ—æ·±åº¦: %4.1f, å¹³å‡ç­‰å¾…: %6.2f ms\n", $9, $10}'
    fi
done
```

### 7.5 æ€§èƒ½é—®é¢˜è¯Šæ–­


**å¸¸è§æ€§èƒ½é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**ï¼š

| é—®é¢˜ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| **è¯»å†™é€Ÿåº¦æ…¢** | `ç£ç›˜è€åŒ–æˆ–è´Ÿè½½è¿‡é«˜` | `æ£€æŸ¥ç£ç›˜å¥åº·ï¼Œä¼˜åŒ–åº”ç”¨è´Ÿè½½` |
| **å»¶è¿Ÿè¿‡é«˜** | `ç£ç›˜ç¢ç‰‡æˆ–è°ƒåº¦ç®—æ³•ä¸å½“` | `æ•´ç†ç¢ç‰‡ï¼Œè°ƒæ•´I/Oè°ƒåº¦å™¨` |
| **CPUä½¿ç”¨ç‡é«˜** | `RAIDçº§åˆ«è®¡ç®—é‡å¤§` | `è€ƒè™‘ç¡¬ä»¶RAIDæˆ–é™ä½æ ¡éªŒé¢‘ç‡` |
| **åŒæ­¥é€Ÿåº¦æ…¢** | `é™åˆ¶è®¾ç½®è¿‡ä½` | `é€‚å½“æé«˜åŒæ­¥é€Ÿåº¦é™åˆ¶` |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„ç›‘æ§æŠ€èƒ½


**ğŸ”¥ å¿…ä¼šæŠ€èƒ½æ¸…å•**
- âœ… **ç†Ÿç»ƒä½¿ç”¨** `mdadm --detail` æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
- âœ… **ç†è§£** `/proc/mdstat` è¾“å‡ºä¿¡æ¯çš„å«ä¹‰  
- âœ… **è¯†åˆ«** é˜µåˆ—å¥åº·çŠ¶æ€å’Œé—®é¢˜å¾è±¡
- âœ… **ç›‘æ§** é‡å»ºå’Œæ ¡éªŒè¿‡ç¨‹çš„è¿›åº¦
- âœ… **åˆ†æ** é”™è¯¯æ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯
- âœ… **è°ƒä¼˜** åŸºæœ¬æ€§èƒ½å‚æ•°

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§çš„æœ¬è´¨ç›®çš„**
```
é¢„é˜²èƒœäºæ²»ç–—ï¼š
â€¢ åŠæ—¶å‘ç°é—®é¢˜ â†’ é¿å…æ•°æ®ä¸¢å¤±
â€¢ ä¼˜åŒ–æ€§èƒ½è¡¨ç° â†’ æå‡ç”¨æˆ·ä½“éªŒ  
â€¢ é¢„æµ‹æ•…éšœè¶‹åŠ¿ â†’ ä¸»åŠ¨ç»´æŠ¤ç®¡ç†
```

**ğŸ”¹ çŠ¶æ€åˆ¤æ–­çš„æ ¸å¿ƒé€»è¾‘**
```
çŠ¶æ€è¯„ä¼°ä¼˜å…ˆçº§ï¼š
1. æ˜¯å¦æœ‰è®¾å¤‡æ•…éšœï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. æ˜¯å¦åœ¨è¿›è¡Œé‡å»º/åŒæ­¥ï¼ˆéœ€è¦ç­‰å¾…ï¼‰
3. é”™è¯¯æ•°é‡æ˜¯å¦åœ¨å¢é•¿ï¼ˆéœ€è¦å…³æ³¨ï¼‰
4. æ€§èƒ½æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼ˆä¼˜åŒ–ç›®æ ‡ï¼‰
```

**ğŸ”¹ æ•…éšœå¤„ç†çš„åŸºæœ¬åŸåˆ™**
```
å¤„ç†åŸåˆ™ï¼š
â€¢ å…ˆç¡®ä¿æ•°æ®å®‰å…¨ï¼Œå†è€ƒè™‘æ€§èƒ½
â€¢ åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œç»´æŠ¤æ“ä½œ
â€¢ åšå¥½å¤‡ä»½åå†è¿›è¡Œé£é™©æ“ä½œ
â€¢ è®°å½•æ“ä½œæ—¥å¿—ï¼Œä¾¿äºé—®é¢˜è¿½è¸ª
```

### 8.3 å®ç”¨æ“ä½œå¤‡å¿˜


**âš¡ å¿«é€Ÿè¯Šæ–­å‘½ä»¤ç»„åˆ**
```bash
# ä¸€é”®å¥åº·æ£€æŸ¥
cat /proc/mdstat && \
for md in /dev/md*; do [ -b "$md" ] && mdadm --detail "$md"; done

# æ€§èƒ½å¿«é€Ÿè¯„ä¼°
iostat -x 1 3 | grep md

# é”™è¯¯å¿«é€Ÿæ’æŸ¥  
dmesg | grep -i "raid\|md\|error" | tail -10
```

**ğŸš¨ ç´§æ€¥æƒ…å†µå¤„ç†æ¸…å•**
1. **å‘ç°æ•…éšœ** â†’ ç«‹å³æ£€æŸ¥ `/proc/mdstat` ç¡®è®¤å½±å“èŒƒå›´
2. **é˜µåˆ—é™çº§** â†’ å‡†å¤‡çƒ­å¤‡ç›˜æˆ–æ–°ç¡¬ç›˜ï¼Œå°½å¿«æ›´æ¢
3. **é‡å»ºä¸­æ–­** â†’ æ£€æŸ¥ç¡¬ä»¶è¿æ¥ï¼Œå¿…è¦æ—¶é‡æ–°å¼€å§‹é‡å»º
4. **æ€§èƒ½å¼‚å¸¸** â†’ æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½å’Œç£ç›˜å¥åº·çŠ¶æ€

### 8.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ“ˆ æ—¥å¸¸è¿ç»´å»ºè®®**
```
ç›‘æ§é¢‘ç‡å»ºè®®ï¼š
â€¢ å®æ—¶ç›‘æ§ï¼šè‡ªåŠ¨åŒ–è„šæœ¬æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
â€¢ è¯¦ç»†æ£€æŸ¥ï¼šæ¯å¤©æ‰‹åŠ¨æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€
â€¢ æ·±åº¦æ ¡éªŒï¼šæ¯æœˆæ‰§è¡Œä¸€æ¬¡æ•°æ®æ ¡éªŒ
â€¢ æ€§èƒ½è¯„ä¼°ï¼šæ¯å‘¨åˆ†æä¸€æ¬¡æ€§èƒ½è¶‹åŠ¿
```

**ğŸ›¡ï¸ é¢„é˜²æ€§æªæ–½**
- è®¾ç½®ç›‘æ§å‘Šè­¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
- å‡†å¤‡çƒ­å¤‡ç£ç›˜ï¼Œå¿«é€Ÿåº”å¯¹æ•…éšœ
- è®°å½•ç»´æŠ¤æ—¥å¿—ï¼Œç§¯ç´¯ç»éªŒçŸ¥è¯†

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ğŸ“Š **ç›‘æ§ä¸‰çœ‹**ï¼šçœ‹çŠ¶æ€ã€çœ‹è¿›åº¦ã€çœ‹é”™è¯¯  
> ğŸ”§ **å¤„ç†ä¸‰æ­¥**ï¼šæŸ¥åŸå› ã€æ¢ç¡¬ä»¶ã€å»ºæ•°æ®  
> âš¡ **ä¼˜åŒ–ä¸‰è°ƒ**ï¼šè°ƒç¼“å­˜ã€è°ƒè°ƒåº¦ã€è°ƒé™é€Ÿ  
> ğŸ›¡ï¸ **é¢„é˜²ä¸‰å¤‡**ï¼šå¤‡ç›‘æ§ã€å¤‡ç¡¬ä»¶ã€å¤‡æ•°æ®