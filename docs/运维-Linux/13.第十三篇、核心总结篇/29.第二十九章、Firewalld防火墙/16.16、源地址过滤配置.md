---
title: 16ã€æºåœ°å€è¿‡æ»¤é…ç½®
---
## ğŸ“š ç›®å½•

1. [æºåœ°å€è¿‡æ»¤æ¦‚å¿µ](#1-æºåœ°å€è¿‡æ»¤æ¦‚å¿µ)
2. [IPåœ°å€èŒƒå›´é…ç½®](#2-ipåœ°å€èŒƒå›´é…ç½®)
3. [CIDRç½‘æ®µé…ç½®](#3-cidrç½‘æ®µé…ç½®)
4. [æºåœ°å€ç™½åå•é»‘åå•](#4-æºåœ°å€ç™½åå•é»‘åå•)
5. [åœ°å€é›†åˆç®¡ç†](#5-åœ°å€é›†åˆç®¡ç†)
6. [åŠ¨æ€IPå¤„ç†](#6-åŠ¨æ€ipå¤„ç†)
7. [åœ°å€è¿‡æ»¤éªŒè¯](#7-åœ°å€è¿‡æ»¤éªŒè¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æºåœ°å€è¿‡æ»¤æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æºåœ°å€è¿‡æ»¤


**æœ¬è´¨å«ä¹‰**ï¼šæºåœ°å€è¿‡æ»¤å°±æ˜¯æ ¹æ®æ•°æ®åŒ…çš„**æ¥æºIPåœ°å€**æ¥å†³å®šæ˜¯å¦å…è®¸é€šè¿‡é˜²ç«å¢™ï¼Œç®€å•è¯´å°±æ˜¯"çœ‹æ¥å¤´å†³å®šæ”¾ä¸æ”¾è¡Œ"ã€‚

```
æƒ³è±¡æˆé—¨ç¦ç³»ç»Ÿï¼š
ğŸ  ä½ å®¶é—¨å£ â† è¿™æ˜¯é˜²ç«å¢™
ğŸ‘¤ è®¿å®¢      â† è¿™æ˜¯æ•°æ®åŒ…
ğŸ“‹ èº«ä»½è¯    â† è¿™æ˜¯æºIPåœ°å€

é—¨ç¦è§„åˆ™ï¼šåªå…è®¸ç‰¹å®šèº«ä»½çš„äººè¿›å…¥
é˜²ç«å¢™è§„åˆ™ï¼šåªå…è®¸ç‰¹å®šIPçš„æ•°æ®åŒ…é€šè¿‡
```

**ä¸ºä»€ä¹ˆéœ€è¦æºåœ°å€è¿‡æ»¤**ï¼š
- **å®‰å…¨æ€§**ï¼šé˜»æ­¢æ¶æ„IPè®¿é—®ç³»ç»Ÿ
- **è®¿é—®æ§åˆ¶**ï¼šåªå…è®¸æŒ‡å®šç”¨æˆ·æˆ–ç½‘æ®µè®¿é—®
- **èµ„æºä¿æŠ¤**ï¼šé˜²æ­¢æœªæˆæƒè®¿é—®æ•æ„ŸæœåŠ¡
- **å¸¦å®½ç®¡ç†**ï¼šé™åˆ¶ç‰¹å®šæ¥æºçš„æµé‡

### 1.2 å·¥ä½œåŸç†æœºåˆ¶


**è¿‡æ»¤æµç¨‹å›¾ç¤º**ï¼š
```
ç½‘ç»œæ•°æ®åŒ…åˆ°è¾¾ â†’ æ£€æŸ¥æºIPåœ°å€ â†’ åŒ¹é…è§„åˆ™ â†’ æ‰§è¡ŒåŠ¨ä½œ
     â†“              â†“            â†“        â†“
  æ¥è‡ª192.168.1.100  æå–æºIP     æŸ¥è§„åˆ™è¡¨   å…è®¸/æ‹’ç»
```

**è§„åˆ™åŒ¹é…é€»è¾‘**ï¼š
1. **ç²¾ç¡®åŒ¹é…**ï¼šå®Œå…¨ç›¸åŒçš„IPåœ°å€
2. **èŒƒå›´åŒ¹é…**ï¼šIPåœ°å€åœ¨æŒ‡å®šèŒƒå›´å†…
3. **ç½‘æ®µåŒ¹é…**ï¼šIPå±äºæŸä¸ªç½‘æ®µ
4. **é›†åˆåŒ¹é…**ï¼šIPåœ¨é¢„å®šä¹‰çš„åœ°å€é›†åˆä¸­

### 1.3 åº”ç”¨åœºæ™¯å®ä¾‹


| åº”ç”¨åœºæ™¯ | **å…¸å‹éœ€æ±‚** | **é…ç½®ç­–ç•¥** |
|---------|-------------|-------------|
| ğŸ¢ **åŠå…¬ç½‘ç»œ** | `åªå…è®¸å…¬å¸å†…ç½‘è®¿é—®` | `é…ç½®å†…ç½‘IPæ®µç™½åå•` |
| ğŸŒ **WebæœåŠ¡** | `é˜»æ­¢å·²çŸ¥æ”»å‡»IP` | `é…ç½®æ¶æ„IPé»‘åå•` |
| ğŸ”’ **SSHæœåŠ¡** | `åªå…è®¸ç®¡ç†å‘˜IP` | `é…ç½®ç®¡ç†å‘˜IPç™½åå•` |
| ğŸ“Š **ç›‘æ§ç³»ç»Ÿ** | `é™åˆ¶ç›‘æ§æ¥æº` | `é…ç½®ç›‘æ§æœåŠ¡å™¨IPæ®µ` |

---

## 2. ğŸ“¡ IPåœ°å€èŒƒå›´é…ç½®


### 2.1 å•ä¸ªIPåœ°å€é…ç½®


**é…ç½®è¯­æ³•**ï¼šå…è®¸æˆ–æ‹’ç»ç‰¹å®šIPåœ°å€è®¿é—®

```bash
# å…è®¸ç‰¹å®šIPè®¿é—®
firewall-cmd --zone=public --add-source=192.168.1.100

# æ‹’ç»ç‰¹å®šIPè®¿é—®ï¼ˆé€šè¿‡richè§„åˆ™ï¼‰
firewall-cmd --zone=public --add-rich-rule='rule source address="192.168.1.100" reject'
```

**ğŸ’¡ ä½¿ç”¨åœºæ™¯**ï¼š
- **VIPç”¨æˆ·**ï¼šç»™é‡è¦å®¢æˆ·å¼€æ”¾ç‰¹æƒè®¿é—®
- **ç®¡ç†å‘˜IP**ï¼šå…è®¸ç®¡ç†å‘˜è¿œç¨‹ç®¡ç†
- **æ¶æ„IP**ï¼šé˜»æ­¢å·²ç¡®è®¤çš„æ”»å‡»æº

### 2.2 IPåœ°å€èŒƒå›´é…ç½®


**è¿ç»­èŒƒå›´é…ç½®**ï¼šå…è®¸ä¸€ä¸ªè¿ç»­çš„IPåœ°å€æ®µ

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨CIDRè¡¨ç¤ºæ³•ï¼ˆæ¨èï¼‰
firewall-cmd --zone=trusted --add-source=192.168.1.0/24

# æ–¹æ³•2ï¼šä½¿ç”¨richè§„åˆ™æŒ‡å®šèŒƒå›´
firewall-cmd --zone=public --add-rich-rule='rule source address="192.168.1.10-192.168.1.50" accept'
```

**èŒƒå›´è¡¨ç¤ºæ–¹æ³•å¯¹æ¯”**ï¼š

| æ–¹æ³• | **è¯­æ³•ç¤ºä¾‹** | **å«ä¹‰** | **ä¼˜ç¼ºç‚¹** |
|------|-------------|---------|-----------|
| **CIDR** | `192.168.1.0/24` | `192.168.1.1-192.168.1.254` | `ç®€æ´æ ‡å‡†ï¼Œæ¨èä½¿ç”¨` |
| **èŒƒå›´** | `192.168.1.10-50` | `192.168.1.10-192.168.1.50` | `ç›´è§‚ä½†ä¸å¤Ÿæ ‡å‡†` |
| **æ©ç ** | `192.168.1.0/255.255.255.0` | `ç­‰åŒäº/24` | `ä¼ ç»Ÿæ–¹å¼ï¼Œè¾ƒå†—é•¿` |

### 2.3 å¤šä¸ªä¸è¿ç»­IPé…ç½®


**é…ç½®å¤šä¸ªå•ç‹¬IP**ï¼š

```bash
# é€ä¸ªæ·»åŠ IPåœ°å€
firewall-cmd --zone=public --add-source=192.168.1.10
firewall-cmd --zone=public --add-source=192.168.1.20
firewall-cmd --zone=public --add-source=10.0.0.5

# ä½¿ç”¨è„šæœ¬æ‰¹é‡æ·»åŠ 
#!/bin/bash
allowed_ips=(
    "192.168.1.10"
    "192.168.1.20" 
    "10.0.0.5"
    "172.16.0.100"
)

for ip in "${allowed_ips[@]}"; do
    firewall-cmd --permanent --zone=trusted --add-source="$ip"
done
```

---

## 3. ğŸŒ CIDRç½‘æ®µé…ç½®


### 3.1 CIDRåŸºç¡€æ¦‚å¿µ


**CIDRå…¨ç§°**ï¼šClassless Inter-Domain Routingï¼ˆæ— ç±»åŸŸé—´è·¯ç”±ï¼‰

**é€šä¿—è§£é‡Š**ï¼šCIDRå°±åƒæ˜¯åˆ’åˆ†ç½‘ç»œé‚»å±…çš„ä¸€ç§æ ‡è®°æ–¹æ³•ï¼Œç”¨`/æ•°å­—`æ¥è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªIPåœ°å€å±äºåŒä¸€ä¸ª"å°åŒº"ã€‚

**CIDRè¡¨ç¤ºæ³•å›¾è§£**ï¼š
```
192.168.1.0/24 çš„å«ä¹‰ï¼š

IPåœ°å€ï¼š  192.168.1.0
å­ç½‘æ©ç ï¼š255.255.255.0 (24ä¸ª1)
         11111111.11111111.11111111.00000000

åŒ…å«IPèŒƒå›´ï¼š
â”œâ”€â”€ ç½‘ç»œåœ°å€ï¼š192.168.1.0
â”œâ”€â”€ å¯ç”¨åœ°å€ï¼š192.168.1.1 ~ 192.168.1.254 
â””â”€â”€ å¹¿æ’­åœ°å€ï¼š192.168.1.255
```

### 3.2 å¸¸ç”¨CIDRç½‘æ®µé…ç½®


**ä¼ä¸šç½‘ç»œå…¸å‹é…ç½®**ï¼š

| ç½‘æ®µç±»å‹ | **CIDRè¡¨ç¤º** | **IPæ•°é‡** | **å…¸å‹ç”¨é€”** |
|---------|-------------|-----------|-------------|
| ğŸ¢ **åŠå…¬ç½‘æ®µ** | `192.168.1.0/24` | `254ä¸ªIP` | `å‘˜å·¥åŠå…¬ç”µè„‘` |
| ğŸ–¥ï¸ **æœåŠ¡å™¨ç½‘æ®µ** | `192.168.10.0/24` | `254ä¸ªIP` | `å†…éƒ¨æœåŠ¡å™¨` |
| ğŸ“± **ç§»åŠ¨è®¾å¤‡** | `192.168.20.0/24` | `254ä¸ªIP` | `æ‰‹æœºã€å¹³æ¿` |
| ğŸ”§ **ç®¡ç†ç½‘æ®µ** | `192.168.100.0/28` | `14ä¸ªIP` | `ç½‘ç»œè®¾å¤‡ç®¡ç†` |

```bash
# é…ç½®ä¼ä¸šç½‘ç»œè®¿é—®æƒé™
firewall-cmd --permanent --zone=trusted --add-source=192.168.1.0/24    # åŠå…¬ç½‘æ®µ
firewall-cmd --permanent --zone=dmz --add-source=192.168.10.0/24        # æœåŠ¡å™¨ç½‘æ®µ
firewall-cmd --permanent --zone=public --add-source=192.168.20.0/24     # ç§»åŠ¨è®¾å¤‡
```

### 3.3 CIDRé…ç½®å®è·µ


**ğŸ”§ å®é™…é…ç½®æ­¥éª¤**ï¼š

```bash
# 1. æŸ¥çœ‹å½“å‰ç½‘æ®µé…ç½®
firewall-cmd --zone=public --list-sources

# 2. æ·»åŠ ä¿¡ä»»ç½‘æ®µ
firewall-cmd --zone=trusted --add-source=192.168.0.0/16
firewall-cmd --zone=trusted --add-source=10.0.0.0/8

# 3. æ·»åŠ DMZç½‘æ®µï¼ˆéƒ¨åˆ†ä¿¡ä»»ï¼‰
firewall-cmd --zone=dmz --add-source=172.16.0.0/12

# 4. ä¿å­˜é…ç½®
firewall-cmd --runtime-to-permanent
```

**ç½‘æ®µè§„åˆ’å»ºè®®**ï¼š
- **å†…ç½‘å…¨æ®µ**ï¼š`192.168.0.0/16` è¦†ç›–æ‰€æœ‰192.168.x.x
- **åŠå…¬åŒºåŸŸ**ï¼š`192.168.1.0/24` å…·ä½“åŠå…¬å®¤
- **æœåŠ¡å™¨åŒº**ï¼š`192.168.100.0/24` ç”Ÿäº§æœåŠ¡å™¨
- **æµ‹è¯•åŒºåŸŸ**ï¼š`192.168.200.0/24` å¼€å‘æµ‹è¯•ç¯å¢ƒ

---

## 4. âš–ï¸ æºåœ°å€ç™½åå•é»‘åå•


### 4.1 ç™½åå•æœºåˆ¶è¯¦è§£


**ç™½åå•å«ä¹‰**ï¼šåªå…è®¸åå•å†…çš„IPåœ°å€è®¿é—®ï¼Œå…¶ä»–ä¸€å¾‹æ‹’ç»ï¼Œå°±åƒ"è´µå®¾åå•"ã€‚

**é…ç½®ç™½åå•çš„ä¸¤ç§æ–¹æ³•**ï¼š

**æ–¹æ³•1ï¼šä½¿ç”¨trustedåŒºåŸŸ**
```bash
# å°†ä¿¡ä»»çš„IPåŠ å…¥trustedåŒºåŸŸ
firewall-cmd --permanent --zone=trusted --add-source=192.168.1.100
firewall-cmd --permanent --zone=trusted --add-source=192.168.1.0/24

# trustedåŒºåŸŸé»˜è®¤å…è®¸æ‰€æœ‰æµé‡
firewall-cmd --zone=trusted --list-all
```

**æ–¹æ³•2ï¼šä½¿ç”¨richè§„åˆ™**
```bash
# å…ˆæ‹’ç»æ‰€æœ‰ï¼Œå†å…è®¸ç‰¹å®šIP
firewall-cmd --permanent --zone=public --add-rich-rule='rule source address="0.0.0.0/0" reject'
firewall-cmd --permanent --zone=public --add-rich-rule='rule source address="192.168.1.100" accept'
```

### 4.2 é»‘åå•æœºåˆ¶è¯¦è§£


**é»‘åå•å«ä¹‰**ï¼šæ‹’ç»åå•å†…çš„IPåœ°å€è®¿é—®ï¼Œå…¶ä»–æ­£å¸¸æ”¾è¡Œï¼Œå°±åƒ"é»‘åå•ç”¨æˆ·"ã€‚

**é…ç½®é»‘åå•ç¤ºä¾‹**ï¼š

```bash
# é˜»æ­¢æ¶æ„IPè®¿é—®
firewall-cmd --permanent --zone=public --add-rich-rule='rule source address="192.168.1.666" drop'

# é˜»æ­¢æ•´ä¸ªæ¶æ„ç½‘æ®µ
firewall-cmd --permanent --zone=public --add-rich-rule='rule source address="10.10.10.0/24" reject'

# é˜»æ­¢ç‰¹å®šå›½å®¶IPæ®µï¼ˆç¤ºä¾‹ï¼‰
firewall-cmd --permanent --zone=public --add-rich-rule='rule source address="203.0.113.0/24" drop'
```

### 4.3 ç™½åå•vsé»‘åå•é€‰æ‹©


**ä½¿ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

| åœºæ™¯ç±»å‹ | **æ¨èç­–ç•¥** | **é…ç½®ç‰¹ç‚¹** | **å®‰å…¨çº§åˆ«** |
|---------|-------------|-------------|-------------|
| ğŸ”’ **é«˜å®‰å…¨æœåŠ¡** | **ç™½åå•æœºåˆ¶** | `åªå…è®¸æŒ‡å®šIPï¼Œé»˜è®¤æ‹’ç»` | `â­â­â­â­â­` |
| ğŸŒ **å…¬å…±WebæœåŠ¡** | **é»‘åå•æœºåˆ¶** | `é˜»æ­¢æ¶æ„IPï¼Œé»˜è®¤å…è®¸` | `â­â­â­â˜†â˜†` |
| ğŸ¢ **ä¼ä¸šå†…ç½‘** | **ç™½åå•+é»‘åå•** | `å†…ç½‘ç™½åå•+å¤–ç½‘é»‘åå•` | `â­â­â­â­â˜†` |

**ğŸ’¡ æœ€ä½³å®è·µç»„åˆ**ï¼š
```bash
# 1. è®¾ç½®å†…ç½‘ç™½åå•
firewall-cmd --permanent --zone=trusted --add-source=192.168.0.0/16

# 2. è®¾ç½®å¤–ç½‘é»‘åå•
firewall-cmd --permanent --zone=public --add-rich-rule='rule source address="æ¶æ„IP" drop'

# 3. é»˜è®¤ç­–ç•¥é€‚ä¸­
firewall-cmd --permanent --zone=public --set-target=default
```

---

## 5. ğŸ“¦ åœ°å€é›†åˆç®¡ç†


### 5.1 IPSetåœ°å€é›†åˆæ¦‚å¿µ


**ä»€ä¹ˆæ˜¯IPSet**ï¼šIPSetå°±åƒæ˜¯ä¸€ä¸ª"IPåœ°å€é€šè®¯å½•"ï¼Œå¯ä»¥æŠŠç›¸å…³çš„IPåœ°å€å½’ç±»ç®¡ç†ï¼Œæ¯”å¦‚"å…¬å¸å‘˜å·¥IPåå•"ã€"é»‘åå•IPé›†åˆ"ç­‰ã€‚

**IPSetçš„ä¼˜åŠ¿**ï¼š
- **æ€§èƒ½ä¼˜åŠ¿**ï¼šæŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œç‰¹åˆ«æ˜¯å¤§é‡IPæ—¶
- **ç®¡ç†æ–¹ä¾¿**ï¼šç»Ÿä¸€ç®¡ç†ç›¸å…³IPåœ°å€
- **åŠ¨æ€æ›´æ–°**ï¼šå¯ä»¥åŠ¨æ€æ·»åŠ åˆ é™¤IP
- **å†…å­˜é«˜æ•ˆ**ï¼šæ¯”é€ä¸ªè§„åˆ™æ›´èŠ‚çœå†…å­˜

### 5.2 åˆ›å»ºå’Œç®¡ç†IPSet


**åŸºç¡€IPSetæ“ä½œ**ï¼š

```bash
# 1. åˆ›å»ºIPSeté›†åˆ
firewall-cmd --permanent --new-ipset=office_ips --type=hash:ip
firewall-cmd --permanent --new-ipset=server_ips --type=hash:net

# 2. å‘é›†åˆæ·»åŠ IPåœ°å€
firewall-cmd --permanent --ipset=office_ips --add-entry=192.168.1.100
firewall-cmd --permanent --ipset=office_ips --add-entry=192.168.1.101
firewall-cmd --permanent --ipset=server_ips --add-entry=192.168.10.0/24

# 3. æŸ¥çœ‹é›†åˆå†…å®¹
firewall-cmd --ipset=office_ips --get-entries
```

**IPSetç±»å‹è¯´æ˜**ï¼š

| IPSetç±»å‹ | **å­˜å‚¨å†…å®¹** | **ä½¿ç”¨åœºæ™¯** | **ç¤ºä¾‹** |
|----------|-------------|-------------|---------|
| `hash:ip` | `å•ä¸ªIPåœ°å€` | `å‘˜å·¥ç”µè„‘ã€æœåŠ¡å™¨` | `192.168.1.100` |
| `hash:net` | `ç½‘æ®µåœ°å€` | `éƒ¨é—¨ç½‘æ®µã€åŒºåŸŸç½‘æ®µ` | `192.168.1.0/24` |
| `hash:ip,port` | `IP+ç«¯å£ç»„åˆ` | `ç‰¹å®šæœåŠ¡è®¿é—®æ§åˆ¶` | `192.168.1.100,80` |

### 5.3 IPSetåœ¨é˜²ç«å¢™ä¸­çš„åº”ç”¨


**ä½¿ç”¨IPSetåˆ›å»ºè§„åˆ™**ï¼š

```bash
# 1. åˆ›å»ºåŠå…¬å®¤IPé›†åˆ
firewall-cmd --permanent --new-ipset=office_whitelist --type=hash:ip

# 2. æ·»åŠ åŠå…¬å®¤IP
office_ips=("192.168.1.100" "192.168.1.101" "192.168.1.102")
for ip in "${office_ips[@]}"; do
    firewall-cmd --permanent --ipset=office_whitelist --add-entry="$ip"
done

# 3. åœ¨é˜²ç«å¢™è§„åˆ™ä¸­ä½¿ç”¨IPSet
firewall-cmd --permanent --zone=trusted --add-source=ipset:office_whitelist
```

**åŠ¨æ€ç®¡ç†ç¤ºä¾‹**ï¼š
```bash
# ä¸´æ—¶æ·»åŠ æ–°IPï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰
firewall-cmd --ipset=office_whitelist --add-entry=192.168.1.103

# æ°¸ä¹…æ·»åŠ æ–°IP
firewall-cmd --permanent --ipset=office_whitelist --add-entry=192.168.1.103

# åˆ é™¤IP
firewall-cmd --permanent --ipset=office_whitelist --remove-entry=192.168.1.100
```

---

## 6. ğŸ”„ åŠ¨æ€IPå¤„ç†


### 6.1 åŠ¨æ€IPæŒ‘æˆ˜


**ä»€ä¹ˆæ˜¯åŠ¨æ€IPé—®é¢˜**ï¼šå¾ˆå¤šç”¨æˆ·çš„IPåœ°å€ä¼šå˜åŒ–ï¼ˆæ¯”å¦‚å®¶åº­å®½å¸¦ã€ç§»åŠ¨ç½‘ç»œï¼‰ï¼Œå›ºå®šIPè§„åˆ™å°±ä¸é€‚ç”¨äº†ã€‚

**å¸¸è§åŠ¨æ€IPåœºæ™¯**ï¼š
- ğŸ  **å®¶åº­å®½å¸¦**ï¼šISPå®šæœŸæ›´æ¢IPåœ°å€
- ğŸ“± **ç§»åŠ¨ç½‘ç»œ**ï¼šæ‰‹æœºç½‘ç»œIPéšåŸºç«™å˜åŒ–
- â˜ï¸ **äº‘æœåŠ¡**ï¼šäº‘ä¸»æœºIPå¯èƒ½å˜åŒ–
- ğŸŒ **CDNæœåŠ¡**ï¼šå†…å®¹åˆ†å‘ç½‘ç»œIPæ± å˜åŒ–

### 6.2 åŠ¨æ€IPå¤„ç†ç­–ç•¥


**ç­–ç•¥1ï¼šå®½æ¾ç½‘æ®µé…ç½®**
```bash
# å…è®¸ISPçš„æ•´ä¸ªIPæ®µ
firewall-cmd --permanent --zone=public --add-source=117.136.0.0/16  # æŸç§»åŠ¨IPæ®µ
firewall-cmd --permanent --zone=public --add-source=61.144.0.0/16   # æŸè”é€šIPæ®µ
```

**ç­–ç•¥2ï¼šåŸºäºåŸŸåçš„åŠ¨æ€è§£æ**
```bash
# ä½¿ç”¨è„šæœ¬å®šæœŸæ›´æ–°IP
#!/bin/bash
# dynamic_ip_update.sh

DOMAIN="home.example.com"
IPSET_NAME="dynamic_ips"

# è§£æåŸŸåè·å–å½“å‰IP
CURRENT_IP=$(dig +short $DOMAIN | head -1)

if [[ $CURRENT_IP =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$ ]]; then
    # æ¸…ç©ºæ—§IP
    firewall-cmd --ipset=$IPSET_NAME --flush
    
    # æ·»åŠ æ–°IP
    firewall-cmd --ipset=$IPSET_NAME --add-entry=$CURRENT_IP
    
    echo "$(date): Updated IP to $CURRENT_IP"
else
    echo "$(date): Failed to resolve $DOMAIN"
fi
```

### 6.3 è‡ªåŠ¨åŒ–åŠ¨æ€IPç®¡ç†


**å®šæ—¶ä»»åŠ¡é…ç½®**ï¼š
```bash
# è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ¯10åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
*/10 * * * * /root/scripts/dynamic_ip_update.sh >> /var/log/dynamic_ip.log 2>&1
```

**åŸºäºæ—¥å¿—çš„IPå­¦ä¹ **ï¼š
```bash
# åˆ†æSSHç™»å½•æˆåŠŸæ—¥å¿—ï¼Œè‡ªåŠ¨æ·»åŠ å¯ä¿¡IP
#!/bin/bash
# auto_learn_ips.sh

# ä»SSHæ—¥å¿—ä¸­æå–æˆåŠŸç™»å½•çš„IP
successful_ips=$(grep "Accepted password" /var/log/secure | awk '{print $11}' | sort -u)

for ip in $successful_ips; do
    # æ£€æŸ¥IPæ˜¯å¦å·²ç»åœ¨ç™½åå•ä¸­
    if ! firewall-cmd --ipset=trusted_ips --query-entry=$ip &>/dev/null; then
        echo "Adding trusted IP: $ip"
        firewall-cmd --ipset=trusted_ips --add-entry=$ip
    fi
done
```

---

## 7. âœ… åœ°å€è¿‡æ»¤éªŒè¯


### 7.1 é…ç½®éªŒè¯æ–¹æ³•


**éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ**ï¼š

```bash
# 1. æŸ¥çœ‹åŒºåŸŸçš„æºåœ°å€é…ç½®
firewall-cmd --zone=public --list-sources
firewall-cmd --zone=trusted --list-sources

# 2. æŸ¥çœ‹å®Œæ•´çš„åŒºåŸŸé…ç½®
firewall-cmd --zone=public --list-all
firewall-cmd --zone=trusted --list-all

# 3. æŸ¥çœ‹æ‰€æœ‰åŒºåŸŸçš„æºåœ°å€
firewall-cmd --list-all-zones | grep -A5 -B5 sources
```

### 7.2 è¿æ¥æµ‹è¯•éªŒè¯


**å®é™…è¿æ¥æµ‹è¯•**ï¼š

```bash
# ä»ä¸åŒIPæµ‹è¯•è¿æ¥
# æµ‹è¯•SSHè¿æ¥
ssh -o ConnectTimeout=5 user@target_server

# æµ‹è¯•HTTPè¿æ¥  
curl -m 5 http://target_server

# æµ‹è¯•ç‰¹å®šç«¯å£
nc -zv target_server 22
telnet target_server 80
```

**ä½¿ç”¨å·¥å…·éªŒè¯**ï¼š
```bash
# 1. ä½¿ç”¨nmapæ‰«æç«¯å£å¯è¾¾æ€§
nmap -p 22,80,443 target_server

# 2. ä½¿ç”¨tcpdumpæŠ“åŒ…éªŒè¯
tcpdump -i any -n host 192.168.1.100

# 3. ä½¿ç”¨netstatæŸ¥çœ‹è¿æ¥çŠ¶æ€
netstat -an | grep :22
ss -tuln | grep :22
```

### 7.3 æ—¥å¿—åˆ†æéªŒè¯


**é˜²ç«å¢™æ—¥å¿—åˆ†æ**ï¼š

```bash
# 1. æŸ¥çœ‹é˜²ç«å¢™æ‹’ç»æ—¥å¿—
journalctl -u firewalld | grep -i reject
journalctl -u firewalld | grep -i drop

# 2. æŸ¥çœ‹å†…æ ¸é˜²ç«å¢™æ—¥å¿—
dmesg | grep -i firewall
tail -f /var/log/messages | grep kernel

# 3. å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•
firewall-cmd --set-log-denied=all
```

**æ—¥å¿—åˆ†æè„šæœ¬**ï¼š
```bash
#!/bin/bash
# firewall_log_analysis.sh

echo "=== é˜²ç«å¢™è®¿é—®ç»Ÿè®¡ ==="
echo "è¢«æ‹’ç»çš„IPåœ°å€ TOP 10:"
journalctl -u firewalld --since="1 hour ago" | grep -i reject | \
awk '{print $8}' | sort | uniq -c | sort -nr | head -10

echo "è¢«å…è®¸çš„è¿æ¥ç»Ÿè®¡:"
journalctl -u firewalld --since="1 hour ago" | grep -i accept | \
awk '{print $8}' | sort | uniq -c | sort -nr | head -10
```

### 7.4 æ•…éšœæ’æŸ¥æ­¥éª¤


**ğŸ”§ å¸¸è§é—®é¢˜è¯Šæ–­**ï¼š

```
é—®é¢˜ï¼šé…ç½®äº†æºåœ°å€ä½†ä»ç„¶æ— æ³•è®¿é—®

æ’æŸ¥æ­¥éª¤ï¼š
1ï¸âƒ£ æ£€æŸ¥é…ç½®æ˜¯å¦ä¿å­˜
   â†’ firewall-cmd --runtime-to-permanent

2ï¸âƒ£ æ£€æŸ¥zoneç»‘å®šæ˜¯å¦æ­£ç¡®  
   â†’ firewall-cmd --get-active-zones

3ï¸âƒ£ æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯ç”¨
   â†’ firewall-cmd --zone=public --list-services

4ï¸âƒ£ æ£€æŸ¥richè§„åˆ™ä¼˜å…ˆçº§
   â†’ firewall-cmd --zone=public --list-rich-rules

5ï¸âƒ£ æ£€æŸ¥ç³»ç»Ÿè·¯ç”±
   â†’ ip route show
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ æºåœ°å€è¿‡æ»¤ï¼šæ ¹æ®æ•°æ®åŒ…æ¥æºIPå†³å®šæ˜¯å¦æ”¾è¡Œ
ğŸŒ CIDRç½‘æ®µï¼šç”¨/æ•°å­—è¡¨ç¤ºIPåœ°å€èŒƒå›´çš„æ ‡å‡†æ–¹æ³•  
âš–ï¸ ç™½åå•é»‘åå•ï¼šå…è®¸ç‰¹å®šIP vs æ‹’ç»ç‰¹å®šIPçš„ä¸¤ç§ç­–ç•¥
ğŸ“¦ IPSeté›†åˆï¼šæ‰¹é‡ç®¡ç†ç›¸å…³IPåœ°å€çš„é«˜æ•ˆæ–¹æ³•
ğŸ”„ åŠ¨æ€IPï¼šå¤„ç†IPåœ°å€å˜åŒ–çš„è‡ªåŠ¨åŒ–ç­–ç•¥
âœ… éªŒè¯æµ‹è¯•ï¼šç¡®ä¿é…ç½®æ­£ç¡®ç”Ÿæ•ˆçš„æ£€æŸ¥æ–¹æ³•
```

### 8.2 å…³é”®é…ç½®å‘½ä»¤é€ŸæŸ¥


| æ“ä½œç±»å‹ | **å‘½ä»¤è¯­æ³•** | **å®é™…ç”¨é€”** |
|---------|-------------|-------------|
| **å•ä¸ªIP** | `--add-source=192.168.1.100` | `å…è®¸ç‰¹å®šIPè®¿é—®` |
| **IPç½‘æ®µ** | `--add-source=192.168.1.0/24` | `å…è®¸æ•´ä¸ªç½‘æ®µè®¿é—®` |
| **æ‹’ç»IP** | `--add-rich-rule='rule source address="IP" reject'` | `æ‹’ç»ç‰¹å®šIPè®¿é—®` |
| **IPSet** | `--add-source=ipset:é›†åˆå` | `ä½¿ç”¨IPé›†åˆç®¡ç†` |

### 8.3 å®é™…åº”ç”¨ç­–ç•¥


**ğŸ”’ é«˜å®‰å…¨ç¯å¢ƒï¼ˆå¦‚ç”Ÿäº§æœåŠ¡å™¨ï¼‰**ï¼š
- ä½¿ç”¨**ç™½åå•æœºåˆ¶**ï¼Œé»˜è®¤æ‹’ç»æ‰€æœ‰
- åªå…è®¸ç®¡ç†å‘˜å’Œä¸šåŠ¡ç³»ç»ŸIP
- å®šæœŸå®¡æŸ¥å’Œæ¸…ç†IPåˆ—è¡¨

**ğŸŒ ä¸€èˆ¬ä¸šåŠ¡ç¯å¢ƒï¼ˆå¦‚WebæœåŠ¡ï¼‰**ï¼š
- ä½¿ç”¨**é»‘åå•æœºåˆ¶**ï¼Œé˜»æ­¢å·²çŸ¥æ¶æ„IP
- é…åˆå…¥ä¾µæ£€æµ‹ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°é»‘åå•
- ä¿æŒæœåŠ¡å¯ç”¨æ€§å’Œå®‰å…¨æ€§å¹³è¡¡

**ğŸ¢ ä¼ä¸šå†…ç½‘ç¯å¢ƒ**ï¼š
- **å†…ç½‘å…¨ä¿¡ä»»**ï¼š192.168.0.0/16åŠ å…¥trusted
- **å¤–ç½‘æœ‰é™åˆ¶**ï¼šç‰¹å®šå…¬ç½‘IPåŠ å…¥ç™½åå•
- **åŠ¨æ€æ›´æ–°**ï¼šVPNç”¨æˆ·IPè‡ªåŠ¨å­¦ä¹ å’Œç®¡ç†

### 8.4 é¿å…å¸¸è§é”™è¯¯


**âŒ é…ç½®è¯¯åŒº**ï¼š
```
è¯¯åŒº1ï¼šå¿˜è®°ä¿å­˜é…ç½®
æ­£ç¡®ï¼šfirewall-cmd --runtime-to-permanent

è¯¯åŒº2ï¼šzoneé…ç½®æ··ä¹±
æ­£ç¡®ï¼šæ˜ç¡®æ¯ä¸ªzoneçš„ç”¨é€”å’ŒIPèŒƒå›´

è¯¯åŒº3ï¼šæµ‹è¯•ä¸å……åˆ†
æ­£ç¡®ï¼šä»å¤šä¸ªæ¥æºIPæµ‹è¯•è¿æ¥

è¯¯åŒº4ï¼šæ—¥å¿—ç›‘æ§ç¼ºå¤±
æ­£ç¡®ï¼šå¯ç”¨æ—¥å¿—è®°å½•ï¼Œå®šæœŸåˆ†æ
```

**ğŸ’¡ æœ€ä½³å®è·µåŸåˆ™**ï¼š
- **æœ€å°æƒé™**ï¼šåªå¼€æ”¾å¿…è¦çš„IPè®¿é—®
- **åˆ†å±‚é˜²æŠ¤**ï¼šç»“åˆç½‘ç»œã€ä¸»æœºå¤šå±‚é˜²æŠ¤
- **å®šæœŸå®¡æŸ¥**ï¼šæ¸…ç†ä¸å†éœ€è¦çš„IPè§„åˆ™  
- **ç›‘æ§å‘Šè­¦**ï¼šå¼‚å¸¸è®¿é—®åŠæ—¶å‘ç°å’Œå¤„ç†

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æºåœ°å€è¿‡æ»¤æ˜¯ç½‘ç»œå®‰å…¨çš„ç¬¬ä¸€é“é˜²çº¿
- CIDRç½‘æ®µè¡¨ç¤ºæ³•æ˜¯IPç®¡ç†çš„æ ‡å‡†æ–¹å¼
- IPSetæä¾›äº†é«˜æ•ˆçš„æ‰¹é‡IPç®¡ç†èƒ½åŠ›
- ç™½åå•æ¯”é»‘åå•æ›´å®‰å…¨ä½†éœ€è¦æ›´å¤šç»´æŠ¤
- åŠ¨æ€IPéœ€è¦è‡ªåŠ¨åŒ–è„šæœ¬æ¥æŒç»­ç®¡ç†
- é…ç½®åå¿…é¡»éªŒè¯æµ‹è¯•ç¡®ä¿è§„åˆ™ç”Ÿæ•ˆ