---
title: 14ã€ç«¯å£è½¬å‘é…ç½®
---
## ğŸ“š ç›®å½•

1. [ç«¯å£è½¬å‘æ¦‚å¿µä¸åº”ç”¨](#1-ç«¯å£è½¬å‘æ¦‚å¿µä¸åº”ç”¨)
2. [æœ¬åœ°ç«¯å£è½¬å‘é…ç½®](#2-æœ¬åœ°ç«¯å£è½¬å‘é…ç½®)
3. [è¿œç¨‹ç«¯å£è½¬å‘é…ç½®](#3-è¿œç¨‹ç«¯å£è½¬å‘é…ç½®)
4. [ç«¯å£è½¬å‘è§„åˆ™è¯­æ³•](#4-ç«¯å£è½¬å‘è§„åˆ™è¯­æ³•)
5. [è½¬å‘è§„åˆ™æŸ¥è¯¢ç®¡ç†](#5-è½¬å‘è§„åˆ™æŸ¥è¯¢ç®¡ç†)
6. [ç«¯å£è½¬å‘æ•…éšœæ’æŸ¥](#6-ç«¯å£è½¬å‘æ•…éšœæ’æŸ¥)
7. [NATè½¬å‘é…ç½®](#7-NATè½¬å‘é…ç½®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ ç«¯å£è½¬å‘æ¦‚å¿µä¸åº”ç”¨


### 1.1 ä»€ä¹ˆæ˜¯ç«¯å£è½¬å‘


**é€šä¿—è§£é‡Š**ï¼šç«¯å£è½¬å‘å°±åƒæ˜¯é‚®ä»¶è½¬å‘ä¸€æ ·ï¼Œå½“æœ‰äººå¾€æŸä¸ªåœ°å€å¯„ä¿¡æ—¶ï¼Œé‚®å±€ä¼šè‡ªåŠ¨æŠŠä¿¡è½¬å‘åˆ°å¦ä¸€ä¸ªåœ°å€ã€‚

```
ä¸¾ä¸ªç”Ÿæ´»ä¾‹å­ï¼š
ä½ æ¬å®¶äº†ï¼Œä½†è¿˜æœ‰äººå¾€è€åœ°å€å¯„ä¿¡
â†’ é‚®å±€è®¾ç½®è½¬å‘ï¼šè€åœ°å€çš„ä¿¡ â†’ è½¬å‘åˆ°æ–°åœ°å€

ç«¯å£è½¬å‘ä¹Ÿæ˜¯å¦‚æ­¤ï¼š
è®¿é—®æœåŠ¡å™¨çš„8080ç«¯å£ â†’ è‡ªåŠ¨è½¬å‘åˆ°80ç«¯å£çš„æœåŠ¡
```

**ä¸“ä¸šå®šä¹‰**ï¼š
- **ç«¯å£è½¬å‘**ï¼šå°†å‘é€åˆ°æŸä¸ªç«¯å£çš„ç½‘ç»œæµé‡é‡å®šå‘åˆ°å¦ä¸€ä¸ªç«¯å£æˆ–å¦ä¸€å°ä¸»æœº
- **ç›®çš„**ï¼šè®©å¤–éƒ¨è®¿é—®å†…éƒ¨æœåŠ¡ï¼Œæˆ–è€…å°†æœåŠ¡æ˜ å°„åˆ°ä¸åŒç«¯å£

### 1.2 ç«¯å£è½¬å‘çš„ä½œç”¨


**ğŸ¯ æ ¸å¿ƒä½œç”¨**

| åº”ç”¨åœºæ™¯ | **å…·ä½“è¯´æ˜** | **å®é™…ä¾‹å­** |
|---------|------------|-------------|
| **æœåŠ¡æ˜ å°„** | `å°†å†…éƒ¨æœåŠ¡æš´éœ²åˆ°å¤–éƒ¨ç«¯å£` | `å†…ç½‘MySQL(3306) â†’ æ˜ å°„åˆ°å¤–ç½‘8306` |
| **ç«¯å£ç»Ÿä¸€** | `å¤šä¸ªæœåŠ¡ä½¿ç”¨ç»Ÿä¸€å…¥å£` | `80ç«¯å£ â†’ æ ¹æ®è§„åˆ™è½¬å‘åˆ°ä¸åŒåç«¯æœåŠ¡` |
| **å®‰å…¨éš”ç¦»** | `éšè—çœŸå®æœåŠ¡ç«¯å£` | `å¤–éƒ¨è®¿é—®8080 â†’ å®é™…æœåŠ¡åœ¨å†…ç½‘3306` |
| **è´Ÿè½½å‡è¡¡** | `æµé‡åˆ†å‘åˆ°å¤šå°æœåŠ¡å™¨` | `è®¿é—®80 â†’ è½®æµè½¬å‘åˆ°å¤šå°WebæœåŠ¡å™¨` |

### 1.3 ç«¯å£è½¬å‘ç±»å‹


**ğŸ”¸ æœ¬åœ°ç«¯å£è½¬å‘**
```
æµé‡æµå‘ï¼šå¤–éƒ¨ â†’ æœåŠ¡å™¨Aç«¯å£ â†’ æœåŠ¡å™¨Aå¦ä¸€ä¸ªç«¯å£
åº”ç”¨ï¼šåŒä¸€å°æœåŠ¡å™¨ä¸åŒç«¯å£é—´çš„è½¬å‘

å¤–éƒ¨è®¿é—®:8080  â”€â”€â”€â”€â†’  æœåŠ¡å™¨A  â”€â”€â”€â”€â†’  æœ¬åœ°:80
              (ç«¯å£è½¬å‘)     (å®é™…æœåŠ¡)
```

**ğŸ”¸ è¿œç¨‹ç«¯å£è½¬å‘**
```
æµé‡æµå‘ï¼šå¤–éƒ¨ â†’ æœåŠ¡å™¨Aç«¯å£ â†’ æœåŠ¡å™¨Bç«¯å£
åº”ç”¨ï¼šä¸åŒæœåŠ¡å™¨é—´çš„è½¬å‘

å¤–éƒ¨è®¿é—®:8080  â”€â”€â”€â”€â†’  æœåŠ¡å™¨A  â”€â”€â”€â”€â†’  æœåŠ¡å™¨B:3306
              (ç«¯å£è½¬å‘)     (MySQLæ•°æ®åº“)
```

### 1.4 å¸¸è§åº”ç”¨åœºæ™¯


**ğŸ’¡ å®é™…ä½¿ç”¨åœºæ™¯**

```
ğŸ”¸ WebæœåŠ¡å™¨åœºæ™¯
é—®é¢˜ï¼šNginxè¿è¡Œåœ¨80ç«¯å£ï¼Œä½†æƒ³é€šè¿‡8080ç«¯å£è®¿é—®
è§£å†³ï¼š8080ç«¯å£ â†’ è½¬å‘åˆ°80ç«¯å£

ğŸ”¸ æ•°æ®åº“è®¿é—®åœºæ™¯  
é—®é¢˜ï¼šMySQLåœ¨å†…ç½‘3306ç«¯å£ï¼Œå¤–ç½‘æ— æ³•ç›´æ¥è®¿é—®
è§£å†³ï¼šå¤–ç½‘8306ç«¯å£ â†’ è½¬å‘åˆ°å†…ç½‘3306ç«¯å£

ğŸ”¸ å¼€å‘æµ‹è¯•åœºæ™¯
é—®é¢˜ï¼šå¼€å‘ç¯å¢ƒå¤šä¸ªé¡¹ç›®éœ€è¦ä¸åŒç«¯å£è®¿é—®
è§£å†³ï¼š8001â†’é¡¹ç›®A, 8002â†’é¡¹ç›®B, 8003â†’é¡¹ç›®C

ğŸ”¸ å®‰å…¨åŠ å›ºåœºæ™¯
é—®é¢˜ï¼šä¸æƒ³æš´éœ²çœŸå®çš„æœåŠ¡ç«¯å£
è§£å†³ï¼šå¤–éƒ¨è®¿é—®é«˜ç«¯å£ â†’ è½¬å‘åˆ°å®é™…æœåŠ¡ç«¯å£
```

---

## 2. ğŸ  æœ¬åœ°ç«¯å£è½¬å‘é…ç½®


### 2.1 åŸºæœ¬è¯­æ³•æ ¼å¼


**å‘½ä»¤è¯­æ³•**ï¼š
```bash
# æ·»åŠ ç«¯å£è½¬å‘è§„åˆ™
firewall-cmd --add-forward-port=port=æºç«¯å£:proto=åè®®:toport=ç›®æ ‡ç«¯å£ [--zone=åŒºåŸŸ]

# å‚æ•°è¯´æ˜ï¼š
# port=æºç«¯å£        ï¼šå¤–éƒ¨è®¿é—®çš„ç«¯å£
# proto=åè®®        ï¼štcp æˆ– udp
# toport=ç›®æ ‡ç«¯å£   ï¼šè½¬å‘åˆ°çš„ç›®æ ‡ç«¯å£
# --zone=åŒºåŸŸ       ï¼šæŒ‡å®šé˜²ç«å¢™åŒºåŸŸ(å¯é€‰)
```

### 2.2 TCPç«¯å£è½¬å‘é…ç½®


**ğŸ”§ é…ç½®æ­¥éª¤**

**æ­¥éª¤ 1ï¸âƒ£**ï¼šæ·»åŠ ç«¯å£è½¬å‘è§„åˆ™
```bash
# å°†8080ç«¯å£è½¬å‘åˆ°80ç«¯å£
firewall-cmd --add-forward-port=port=8080:proto=tcp:toport=80

# éªŒè¯è§„åˆ™æ˜¯å¦æ·»åŠ æˆåŠŸ
firewall-cmd --list-forward-ports
```

**æ­¥éª¤ 2ï¸âƒ£**ï¼šä½¿é…ç½®æ°¸ä¹…ç”Ÿæ•ˆ
```bash
# æ°¸ä¹…æ·»åŠ è§„åˆ™
firewall-cmd --permanent --add-forward-port=port=8080:proto=tcp:toport=80

# é‡æ–°åŠ è½½é…ç½®
firewall-cmd --reload
```

**å®é™…æ•ˆæœéªŒè¯**ï¼š
```
æµ‹è¯•å‰ï¼šcurl http://æœåŠ¡å™¨IP:8080  â†’ è¿æ¥å¤±è´¥
é…ç½®åï¼šcurl http://æœåŠ¡å™¨IP:8080  â†’ æ˜¾ç¤º80ç«¯å£çš„ç½‘é¡µå†…å®¹
```

### 2.3 UDPç«¯å£è½¬å‘é…ç½®


**ğŸ”§ UDPæœåŠ¡è½¬å‘ç¤ºä¾‹**

```bash
# DNSæœåŠ¡è½¬å‘ç¤ºä¾‹ï¼ˆ53ç«¯å£æ˜¯DNSé»˜è®¤ç«¯å£ï¼‰
firewall-cmd --add-forward-port=port=5353:proto=udp:toport=53

# æ¸¸æˆæœåŠ¡å™¨è½¬å‘ç¤ºä¾‹
firewall-cmd --add-forward-port=port=7777:proto=udp:toport=25565

# æ°¸ä¹…ç”Ÿæ•ˆ
firewall-cmd --permanent --add-forward-port=port=5353:proto=udp:toport=53
firewall-cmd --reload
```

### 2.4 æŒ‡å®šåŒºåŸŸçš„è½¬å‘


**ğŸ¯ åŒºåŸŸæŒ‡å®šé…ç½®**

```bash
# æŸ¥çœ‹å½“å‰æ´»åŠ¨åŒºåŸŸ
firewall-cmd --get-active-zones

# åœ¨publicåŒºåŸŸæ·»åŠ è½¬å‘è§„åˆ™
firewall-cmd --zone=public --add-forward-port=port=8080:proto=tcp:toport=80

# åœ¨internalåŒºåŸŸæ·»åŠ è½¬å‘è§„åˆ™ï¼ˆå†…ç½‘ç¯å¢ƒï¼‰
firewall-cmd --zone=internal --add-forward-port=port=3306:proto=tcp:toport=3306

# æ°¸ä¹…é…ç½®
firewall-cmd --permanent --zone=public --add-forward-port=port=8080:proto=tcp:toport=80
```

---

## 3. ğŸŒ è¿œç¨‹ç«¯å£è½¬å‘é…ç½®


### 3.1 è¿œç¨‹è½¬å‘åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯è¿œç¨‹ç«¯å£è½¬å‘**ï¼š
- **æœ¬åœ°è½¬å‘**ï¼šè½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨çš„ä¸åŒç«¯å£
- **è¿œç¨‹è½¬å‘**ï¼šè½¬å‘åˆ°ä¸åŒæœåŠ¡å™¨çš„ç«¯å£

```
æœ¬åœ°è½¬å‘ç¤ºä¾‹ï¼š
å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨A:8080 â†’ æœåŠ¡å™¨A:80

è¿œç¨‹è½¬å‘ç¤ºä¾‹ï¼š  
å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨A:8080 â†’ æœåŠ¡å™¨B:3306
```

### 3.2 è¿œç¨‹è½¬å‘è¯­æ³•


**å®Œæ•´è¯­æ³•æ ¼å¼**ï¼š
```bash
# è¿œç¨‹ç«¯å£è½¬å‘è¯­æ³•
firewall-cmd --add-forward-port=port=æºç«¯å£:proto=åè®®:toaddr=ç›®æ ‡IP:toport=ç›®æ ‡ç«¯å£

# å‚æ•°è¯¦è§£ï¼š
# port=æºç«¯å£      ï¼šå¤–éƒ¨è®¿é—®çš„ç«¯å£
# proto=åè®®      ï¼štcp æˆ– udp  
# toaddr=ç›®æ ‡IP   ï¼šç›®æ ‡æœåŠ¡å™¨çš„IPåœ°å€
# toport=ç›®æ ‡ç«¯å£ ï¼šç›®æ ‡æœåŠ¡å™¨çš„ç«¯å£
```

### 3.3 è¿œç¨‹è½¬å‘é…ç½®å®ä¾‹


**ğŸ”§ æ•°æ®åº“è®¿é—®è½¬å‘**

```bash
# åœºæ™¯ï¼šå¤–ç½‘é€šè¿‡8306ç«¯å£è®¿é—®å†…ç½‘MySQLæ•°æ®åº“
# å†…ç½‘MySQLæœåŠ¡å™¨ï¼š192.168.1.100:3306
# é˜²ç«å¢™æœåŠ¡å™¨ä½œä¸ºè·³æ¿

# 1. æ·»åŠ è¿œç¨‹è½¬å‘è§„åˆ™
firewall-cmd --add-forward-port=port=8306:proto=tcp:toaddr=192.168.1.100:toport=3306

# 2. æ£€æŸ¥è§„åˆ™
firewall-cmd --list-forward-ports

# 3. æ°¸ä¹…é…ç½®
firewall-cmd --permanent --add-forward-port=port=8306:proto=tcp:toaddr=192.168.1.100:toport=3306
firewall-cmd --reload
```

**ğŸ”§ WebæœåŠ¡è½¬å‘**

```bash
# åœºæ™¯ï¼šå°†å¤–ç½‘80ç«¯å£è½¬å‘åˆ°å†…ç½‘WebæœåŠ¡å™¨
# å†…ç½‘WebæœåŠ¡å™¨ï¼š192.168.1.200:8080

firewall-cmd --add-forward-port=port=80:proto=tcp:toaddr=192.168.1.200:toport=8080
firewall-cmd --permanent --add-forward-port=port=80:proto=tcp:toaddr=192.168.1.200:toport=8080
firewall-cmd --reload
```

### 3.4 è¿œç¨‹è½¬å‘å‰ç½®æ¡ä»¶


**âš ï¸ é‡è¦å‰ææ¡ä»¶**

```bash
# 1. å¯ç”¨IPè½¬å‘åŠŸèƒ½
echo 'net.ipv4.ip_forward = 1' >> /etc/sysctl.conf
sysctl -p

# 2. å¯ç”¨firewalldçš„masqueradeåŠŸèƒ½
firewall-cmd --add-masquerade
firewall-cmd --permanent --add-masquerade

# 3. ç¡®ä¿ç›®æ ‡æœåŠ¡å™¨ç½‘ç»œå¯è¾¾
ping 192.168.1.100

# éªŒè¯IPè½¬å‘æ˜¯å¦å¯ç”¨
cat /proc/sys/net/ipv4/ip_forward
# è¾“å‡º1è¡¨ç¤ºå·²å¯ç”¨
```

**ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
- âœ… IPè½¬å‘åŠŸèƒ½å·²å¯ç”¨
- âœ… masqueradeåŠŸèƒ½å·²å¼€å¯  
- âœ… ç›®æ ‡æœåŠ¡å™¨ç½‘ç»œè¿é€š
- âœ… ç›®æ ‡æœåŠ¡å™¨é˜²ç«å¢™å…è®¸è®¿é—®
- âœ… è½¬å‘è§„åˆ™è¯­æ³•æ­£ç¡®

---

## 4. ğŸ“ ç«¯å£è½¬å‘è§„åˆ™è¯­æ³•


### 4.1 å®Œæ•´è¯­æ³•ç»“æ„


**ğŸ”¸ è¯­æ³•ç»„æˆè¦ç´ **

```bash
firewall-cmd --add-forward-port=port=æºç«¯å£:proto=åè®®:toport=ç›®æ ‡ç«¯å£:toaddr=ç›®æ ‡IP

å‚æ•°åˆ†è§£ï¼š
â”œâ”€â”€ port=æºç«¯å£        # å¿…éœ€ï¼šå¤–éƒ¨è®¿é—®ç«¯å£
â”œâ”€â”€ proto=åè®®         # å¿…éœ€ï¼štcp/udp
â”œâ”€â”€ toport=ç›®æ ‡ç«¯å£    # å¯é€‰ï¼šä¸æŒ‡å®šåˆ™ä¸æºç«¯å£ç›¸åŒ
â””â”€â”€ toaddr=ç›®æ ‡IP      # å¯é€‰ï¼šä¸æŒ‡å®šåˆ™ä¸ºæœ¬åœ°è½¬å‘
```

### 4.2 è¯­æ³•è§„åˆ™è¯¦è§£


**ğŸ”¹ ç«¯å£å‚æ•°è§„åˆ™**

| å‚æ•° | **å¿…éœ€æ€§** | **æ ¼å¼** | **ç¤ºä¾‹** | **è¯´æ˜** |
|------|-----------|---------|---------|----------|
| `port` | **å¿…éœ€** | `æ•°å­—` | `port=8080` | `å¤–éƒ¨è®¿é—®çš„ç«¯å£å·` |
| `proto` | **å¿…éœ€** | `tcp/udp` | `proto=tcp` | `åè®®ç±»å‹ï¼Œåªèƒ½æ˜¯tcpæˆ–udp` |
| `toport` | **å¯é€‰** | `æ•°å­—` | `toport=80` | `ç›®æ ‡ç«¯å£ï¼Œä¸æŒ‡å®šåˆ™ä¸portç›¸åŒ` |
| `toaddr` | **å¯é€‰** | `IPåœ°å€` | `toaddr=192.168.1.100` | `ç›®æ ‡IPï¼Œä¸æŒ‡å®šåˆ™ä¸ºæœ¬åœ°è½¬å‘` |

### 4.3 å¸¸ç”¨è¯­æ³•æ¨¡æ¿


**ğŸ“‹ å®ç”¨è¯­æ³•æ¨¡æ¿**

```bash
# æ¨¡æ¿1ï¼šæœ¬åœ°ç«¯å£è½¬å‘
firewall-cmd --add-forward-port=port=8080:proto=tcp:toport=80

# æ¨¡æ¿2ï¼šè¿œç¨‹ç«¯å£è½¬å‘ï¼ˆç›¸åŒç«¯å£ï¼‰
firewall-cmd --add-forward-port=port=3306:proto=tcp:toaddr=192.168.1.100

# æ¨¡æ¿3ï¼šè¿œç¨‹ç«¯å£è½¬å‘ï¼ˆä¸åŒç«¯å£ï¼‰  
firewall-cmd --add-forward-port=port=8080:proto=tcp:toaddr=192.168.1.100:toport=80

# æ¨¡æ¿4ï¼šUDPæœåŠ¡è½¬å‘
firewall-cmd --add-forward-port=port=53:proto=udp:toaddr=192.168.1.100:toport=53

# æ¨¡æ¿5ï¼šæŒ‡å®šåŒºåŸŸè½¬å‘
firewall-cmd --zone=public --add-forward-port=port=8080:proto=tcp:toport=80
```

### 4.4 è¯­æ³•é”™è¯¯é¿å…


**â— å¸¸è§è¯­æ³•é”™è¯¯**

```bash
# âŒ é”™è¯¯ï¼šç¼ºå°‘å¿…éœ€å‚æ•°
firewall-cmd --add-forward-port=port=8080  # ç¼ºå°‘protoå‚æ•°

# âŒ é”™è¯¯ï¼šåè®®ç±»å‹é”™è¯¯
firewall-cmd --add-forward-port=port=8080:proto=http  # åªèƒ½æ˜¯tcp/udp

# âŒ é”™è¯¯ï¼šIPåœ°å€æ ¼å¼é”™è¯¯
firewall-cmd --add-forward-port=port=8080:proto=tcp:toaddr=192.168.1  # IPä¸å®Œæ•´

# âŒ é”™è¯¯ï¼šç«¯å£èŒƒå›´é”™è¯¯
firewall-cmd --add-forward-port=port=70000:proto=tcp:toport=80  # ç«¯å£è¶…å‡ºèŒƒå›´

# âœ… æ­£ç¡®ï¼šæ ‡å‡†æ ¼å¼
firewall-cmd --add-forward-port=port=8080:proto=tcp:toport=80
```

**ğŸ”§ è¯­æ³•éªŒè¯æŠ€å·§**ï¼š
```bash
# éªŒè¯è¯­æ³•æ˜¯å¦æ­£ç¡®
firewall-cmd --add-forward-port=port=8080:proto=tcp:toport=80 --dry-run

# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
firewall-cmd --help | grep forward-port
```

---

## 5. ğŸ” è½¬å‘è§„åˆ™æŸ¥è¯¢ç®¡ç†


### 5.1 æŸ¥è¯¢è½¬å‘è§„åˆ™


**ğŸ”¸ åŸºæœ¬æŸ¥è¯¢å‘½ä»¤**

```bash
# æŸ¥çœ‹æ‰€æœ‰ç«¯å£è½¬å‘è§„åˆ™
firewall-cmd --list-forward-ports

# æŸ¥çœ‹æŒ‡å®šåŒºåŸŸçš„è½¬å‘è§„åˆ™
firewall-cmd --zone=public --list-forward-ports

# æŸ¥çœ‹æ‰€æœ‰é…ç½®ï¼ˆåŒ…æ‹¬è½¬å‘è§„åˆ™ï¼‰
firewall-cmd --list-all
```

**æŸ¥è¯¢ç»“æœç¤ºä¾‹**ï¼š
```
è¾“å‡ºç¤ºä¾‹ï¼š
port=8080:proto=tcp:toport=80
port=3306:proto=tcp:toaddr=192.168.1.100:toport=3306
port=53:proto=udp:toaddr=192.168.1.50:toport=53
```

### 5.2 è§„åˆ™ç®¡ç†æ“ä½œ


**ğŸ”§ æ·»åŠ è§„åˆ™**

```bash
# ä¸´æ—¶æ·»åŠ ï¼ˆé‡å¯åå¤±æ•ˆï¼‰
firewall-cmd --add-forward-port=port=8080:proto=tcp:toport=80

# æ°¸ä¹…æ·»åŠ 
firewall-cmd --permanent --add-forward-port=port=8080:proto=tcp:toport=80
firewall-cmd --reload
```

**ğŸ”§ åˆ é™¤è§„åˆ™**

```bash
# ä¸´æ—¶åˆ é™¤
firewall-cmd --remove-forward-port=port=8080:proto=tcp:toport=80

# æ°¸ä¹…åˆ é™¤
firewall-cmd --permanent --remove-forward-port=port=8080:proto=tcp:toport=80
firewall-cmd --reload
```

**ğŸ”§ æ‰¹é‡ç®¡ç†**

```bash
# æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„è§„åˆ™
firewall-cmd --list-forward-ports > current_rules.txt

# åˆ é™¤æ‰€æœ‰è½¬å‘è§„åˆ™ï¼ˆè°¨æ…æ“ä½œï¼‰
for rule in $(firewall-cmd --list-forward-ports); do
    firewall-cmd --remove-forward-port=$rule
done

# é‡æ–°åŠ è½½é…ç½®
firewall-cmd --reload
```

### 5.3 è§„åˆ™çŠ¶æ€æ£€æŸ¥


**ğŸ“Š è§„åˆ™æœ‰æ•ˆæ€§éªŒè¯**

```bash
# æ£€æŸ¥è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ
firewall-cmd --query-forward-port=port=8080:proto=tcp:toport=80
# è¾“å‡ºï¼šyes (ç”Ÿæ•ˆ) æˆ– no (æœªç”Ÿæ•ˆ)

# æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
firewall-cmd --query-port=8080/tcp

# æŸ¥çœ‹åŒºåŸŸè¯¦ç»†ä¿¡æ¯
firewall-cmd --zone=public --list-all
```

**ğŸ” ç½‘ç»œè¿é€šæ€§æµ‹è¯•**ï¼š
```bash
# æœ¬åœ°æµ‹è¯•ç«¯å£è½¬å‘
curl http://localhost:8080

# è¿œç¨‹æµ‹è¯•ç«¯å£è½¬å‘  
telnet æœåŠ¡å™¨IP 8080

# æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€
netstat -tunlp | grep 8080
ss -tunlp | grep 8080
```

### 5.4 é…ç½®æ–‡ä»¶æŸ¥çœ‹


**ğŸ“‚ é…ç½®æ–‡ä»¶ä½ç½®**

```bash
# æŸ¥çœ‹é˜²ç«å¢™é…ç½®ç›®å½•
ls /etc/firewalld/

# æŸ¥çœ‹åŒºåŸŸé…ç½®æ–‡ä»¶
cat /etc/firewalld/zones/public.xml

# æ°¸ä¹…é…ç½®æ–‡ä»¶ç¤ºä¾‹
<?xml version="1.0" encoding="utf-8"?>
<zone>
  <short>Public</short>
  <forward-port port="8080" protocol="tcp" to-port="80"/>
  <forward-port port="3306" protocol="tcp" to-addr="192.168.1.100" to-port="3306"/>
</zone>
```

---

## 6. ğŸ”§ ç«¯å£è½¬å‘æ•…éšœæ’æŸ¥


### 6.1 å¸¸è§æ•…éšœç°è±¡


**â— å…¸å‹æ•…éšœè¡¨ç°**

```
æ•…éšœç°è±¡1ï¼šå¤–éƒ¨æ— æ³•è®¿é—®è½¬å‘ç«¯å£
ç°è±¡ï¼šcurl http://IP:8080 â†’ è¿æ¥è¶…æ—¶æˆ–æ‹’ç»è¿æ¥

æ•…éšœç°è±¡2ï¼šè½¬å‘è§„åˆ™ä¸ç”Ÿæ•ˆ  
ç°è±¡ï¼šè§„åˆ™æ·»åŠ æˆåŠŸä½†è®¿é—®ä»ç„¶å¤±è´¥

æ•…éšœç°è±¡3ï¼šè¿œç¨‹è½¬å‘æ— æ³•è¿é€š
ç°è±¡ï¼šæœ¬åœ°è½¬å‘æ­£å¸¸ï¼Œè¿œç¨‹è½¬å‘å¤±è´¥
```

### 6.2 åˆ†æ­¥æ’æŸ¥æ–¹æ³•


**ğŸ” æ’æŸ¥æµç¨‹å›¾**

```
ç«¯å£è½¬å‘æ•…éšœæ’æŸ¥æµç¨‹ï¼š

1. æ£€æŸ¥è½¬å‘è§„åˆ™ 
   â”œâ”€ è§„åˆ™æ˜¯å¦å­˜åœ¨ï¼Ÿ â”€â”€â”€â†’ å¦ â”€â”€â”€â†’ æ·»åŠ è§„åˆ™
   â””â”€ è§„åˆ™è¯­æ³•æ­£ç¡®ï¼Ÿ â”€â”€â”€â†’ å¦ â”€â”€â”€â†’ ä¿®æ­£è¯­æ³•
                        â†“
2. æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
   â”œâ”€ firewalldè¿è¡Œï¼Ÿ â”€â”€â”€â†’ å¦ â”€â”€â”€â†’ å¯åŠ¨æœåŠ¡
   â””â”€ æºç«¯å£å¼€æ”¾ï¼Ÿ â”€â”€â”€â”€â”€â†’ å¦ â”€â”€â”€â†’ å¼€æ”¾ç«¯å£
                        â†“
3. æ£€æŸ¥ç³»ç»Ÿé…ç½®
   â”œâ”€ IPè½¬å‘å¯ç”¨ï¼Ÿ â”€â”€â”€â”€â”€â†’ å¦ â”€â”€â”€â†’ å¯ç”¨è½¬å‘
   â””â”€ masqueradeå¯ç”¨ï¼Ÿ â”€â”€â†’ å¦ â”€â”€â”€â†’ å¯ç”¨masquerade
                        â†“
4. æ£€æŸ¥ç›®æ ‡æœåŠ¡
   â”œâ”€ ç›®æ ‡æœåŠ¡è¿è¡Œï¼Ÿ â”€â”€â”€â†’ å¦ â”€â”€â”€â†’ å¯åŠ¨æœåŠ¡
   â””â”€ ç½‘ç»œè¿é€šæ€§ï¼Ÿ â”€â”€â”€â”€â”€â†’ å¦ â”€â”€â”€â†’ æ£€æŸ¥ç½‘ç»œ
```

### 6.3 å…·ä½“æ’æŸ¥æ­¥éª¤


**æ­¥éª¤ 1ï¸âƒ£**ï¼šæ£€æŸ¥è½¬å‘è§„åˆ™
```bash
# æŸ¥çœ‹è½¬å‘è§„åˆ™æ˜¯å¦å­˜åœ¨
firewall-cmd --list-forward-ports

# éªŒè¯è§„åˆ™çŠ¶æ€
firewall-cmd --query-forward-port=port=8080:proto=tcp:toport=80

# æŸ¥çœ‹å®Œæ•´é…ç½®
firewall-cmd --list-all
```

**æ­¥éª¤ 2ï¸âƒ£**ï¼šæ£€æŸ¥é˜²ç«å¢™æœåŠ¡
```bash
# æ£€æŸ¥firewalldçŠ¶æ€
systemctl status firewalld

# æ£€æŸ¥æºç«¯å£æ˜¯å¦å¼€æ”¾
firewall-cmd --query-port=8080/tcp

# å¦‚æœç«¯å£æœªå¼€æ”¾ï¼Œæ·»åŠ ç«¯å£
firewall-cmd --add-port=8080/tcp
firewall-cmd --permanent --add-port=8080/tcp
```

**æ­¥éª¤ 3ï¸âƒ£**ï¼šæ£€æŸ¥ç³»ç»Ÿé…ç½®ï¼ˆè¿œç¨‹è½¬å‘ï¼‰
```bash
# æ£€æŸ¥IPè½¬å‘æ˜¯å¦å¯ç”¨
cat /proc/sys/net/ipv4/ip_forward
# åº”è¯¥è¾“å‡º 1

# å¦‚æœæœªå¯ç”¨ï¼Œå¯ç”¨IPè½¬å‘
echo 1 > /proc/sys/net/ipv4/ip_forward
echo 'net.ipv4.ip_forward = 1' >> /etc/sysctl.conf

# æ£€æŸ¥masqueradeæ˜¯å¦å¯ç”¨
firewall-cmd --query-masquerade
# åº”è¯¥è¾“å‡º yes
```

**æ­¥éª¤ 4ï¸âƒ£**ï¼šæ£€æŸ¥ç›®æ ‡æœåŠ¡
```bash
# æ£€æŸ¥ç›®æ ‡ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tunlp | grep 80
ss -tunlp | grep 80

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼ˆè¿œç¨‹è½¬å‘ï¼‰
ping 192.168.1.100
telnet 192.168.1.100 80

# æ£€æŸ¥ç›®æ ‡æœåŠ¡å™¨é˜²ç«å¢™
# åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
firewall-cmd --query-port=80/tcp
```

### 6.4 æ•…éšœè§£å†³æ–¹æ¡ˆ


**ğŸ”§ è§£å†³æ–¹æ¡ˆæ±‡æ€»**

| æ•…éšœç±»å‹ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ³•** |
|---------|------------|-------------|
| **è§„åˆ™ä¸ç”Ÿæ•ˆ** | `è§„åˆ™è¯­æ³•é”™è¯¯` | `æ£€æŸ¥å¹¶ä¿®æ­£è¯­æ³•æ ¼å¼` |
| **è¿æ¥è¢«æ‹’ç»** | `æºç«¯å£æœªå¼€æ”¾` | `firewall-cmd --add-port=8080/tcp` |
| **è¿œç¨‹è½¬å‘å¤±è´¥** | `IPè½¬å‘æœªå¯ç”¨` | `echo 1 > /proc/sys/net/ipv4/ip_forward` |
| **è½¬å‘æ— å“åº”** | `masqueradeæœªå¯ç”¨` | `firewall-cmd --add-masquerade` |
| **ç›®æ ‡æ— æ³•è®¿é—®** | `ç›®æ ‡æœåŠ¡å™¨é˜²ç«å¢™` | `åœ¨ç›®æ ‡æœåŠ¡å™¨å¼€æ”¾ç«¯å£` |

### 6.5 è°ƒè¯•æŠ€å·§


**ğŸ” å®ç”¨è°ƒè¯•å‘½ä»¤**

```bash
# å®æ—¶ç›‘æ§è¿æ¥
watch -n 1 'netstat -tuln | grep 8080'

# æŸ¥çœ‹è¿æ¥æ—¥å¿—
journalctl -u firewalld -f

# æŠ“åŒ…åˆ†æ
tcpdump -i any -n port 8080

# æµ‹è¯•ç«¯å£è¿é€šæ€§
nmap -p 8080 æœåŠ¡å™¨IP

# æŸ¥çœ‹iptablesè§„åˆ™ï¼ˆfirewalldåº•å±‚ï¼‰
iptables -t nat -L -n
```

---

## 7. ğŸŒ NATè½¬å‘é…ç½®


### 7.1 NATè½¬å‘åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯NATè½¬å‘**ï¼š
- **NAT**ï¼šNetwork Address Translationï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰
- **ä½œç”¨**ï¼šéšè—å†…ç½‘çœŸå®IPï¼Œå®ç°å†…ç½‘åˆ°å¤–ç½‘çš„åœ°å€è½¬æ¢
- **ä¸ç«¯å£è½¬å‘å…³ç³»**ï¼šNATè½¬å‘æ˜¯ç«¯å£è½¬å‘çš„åº•å±‚å®ç°æœºåˆ¶

```
NATè½¬å‘å·¥ä½œåŸç†ï¼š

å¤–ç½‘å®¢æˆ·ç«¯                é˜²ç«å¢™æœåŠ¡å™¨               å†…ç½‘æœåŠ¡å™¨
    |                        |                        |
    |--è®¿é—®å…¬ç½‘IP:8080------->|                        |
    |                        |--è½¬å‘åˆ°å†…ç½‘IP:80------>|
    |                        |                        |
    |<---è¿”å›å“åº”æ•°æ®---------|<--å“åº”æ•°æ®-------------|
    |   (æºIPæ˜¾ç¤ºä¸ºå…¬ç½‘IP)     |   (ä¿®æ”¹æºIPåœ°å€)        |
```

### 7.2 å¯ç”¨NATè½¬å‘åŠŸèƒ½


**ğŸ”§ åŸºç¡€é…ç½®æ­¥éª¤**

**æ­¥éª¤ 1ï¸âƒ£**ï¼šå¯ç”¨masquerade
```bash
# masqueradeæ˜¯NATè½¬å‘çš„æ ¸å¿ƒåŠŸèƒ½
# æŸ¥çœ‹å½“å‰çŠ¶æ€
firewall-cmd --query-masquerade

# å¯ç”¨masqueradeï¼ˆä¸´æ—¶ï¼‰
firewall-cmd --add-masquerade

# æ°¸ä¹…å¯ç”¨
firewall-cmd --permanent --add-masquerade
firewall-cmd --reload
```

**æ­¥éª¤ 2ï¸âƒ£**ï¼šå¯ç”¨ç³»ç»ŸIPè½¬å‘
```bash
# æŸ¥çœ‹å½“å‰IPè½¬å‘çŠ¶æ€
cat /proc/sys/net/ipv4/ip_forward

# ä¸´æ—¶å¯ç”¨IPè½¬å‘
echo 1 > /proc/sys/net/ipv4/ip_forward

# æ°¸ä¹…å¯ç”¨IPè½¬å‘
echo 'net.ipv4.ip_forward = 1' >> /etc/sysctl.conf
sysctl -p
```

### 7.3 NATè½¬å‘è§„åˆ™é…ç½®


**ğŸ¯ å®Œæ•´NATè½¬å‘ç¤ºä¾‹**

```bash
# åœºæ™¯ï¼šå¤–ç½‘è®¿é—®8080ç«¯å£ï¼Œè½¬å‘åˆ°å†…ç½‘WebæœåŠ¡å™¨
# å¤–ç½‘æ¥å£ï¼šeth0 (å…¬ç½‘IP)
# å†…ç½‘æ¥å£ï¼šeth1 (å†…ç½‘IP)
# ç›®æ ‡æœåŠ¡å™¨ï¼š192.168.1.100:80

# 1. å¯ç”¨masquerade
firewall-cmd --add-masquerade
firewall-cmd --permanent --add-masquerade

# 2. æ·»åŠ ç«¯å£è½¬å‘è§„åˆ™
firewall-cmd --add-forward-port=port=8080:proto=tcp:toaddr=192.168.1.100:toport=80
firewall-cmd --permanent --add-forward-port=port=8080:proto=tcp:toaddr=192.168.1.100:toport=80

# 3. é‡æ–°åŠ è½½é…ç½®
firewall-cmd --reload
```

### 7.4 é«˜çº§NATé…ç½®


**ğŸ”¸ å¤šç½‘å¡ç¯å¢ƒé…ç½®**

```bash
# æŸ¥çœ‹ç½‘å¡æ¥å£
ip addr show

# ä¸ºä¸åŒåŒºåŸŸé…ç½®ä¸åŒçš„è½¬å‘è§„åˆ™
# å¤–ç½‘åŒºåŸŸ(public)è½¬å‘åˆ°å†…ç½‘åŒºåŸŸ(internal)

# è®¾ç½®ç½‘å¡åŒºåŸŸ
firewall-cmd --change-interface=eth0 --zone=public
firewall-cmd --change-interface=eth1 --zone=internal

# åœ¨publicåŒºåŸŸå¯ç”¨masquerade
firewall-cmd --zone=public --add-masquerade
firewall-cmd --permanent --zone=public --add-masquerade

# æ·»åŠ è½¬å‘è§„åˆ™
firewall-cmd --zone=public --add-forward-port=port=8080:proto=tcp:toaddr=192.168.1.100:toport=80
```

**ğŸ”¸ å¯Œè§„åˆ™NATé…ç½®**

```bash
# ä½¿ç”¨å¯Œè§„åˆ™å®ç°æ›´çµæ´»çš„NATè½¬å‘
# åªå…è®¸ç‰¹å®šIPè®¿é—®è½¬å‘ç«¯å£

firewall-cmd --add-rich-rule='
rule family=ipv4 
source address=å…è®¸è®¿é—®çš„IPæ®µ 
forward-port port=8080 protocol=tcp to-addr=192.168.1.100 to-port=80'

# ç¤ºä¾‹ï¼šåªå…è®¸10.0.0.0/24ç½‘æ®µè®¿é—®
firewall-cmd --add-rich-rule='
rule family=ipv4 
source address=10.0.0.0/24 
forward-port port=8080 protocol=tcp to-addr=192.168.1.100 to-port=80'
```

### 7.5 NATè½¬å‘éªŒè¯


**âœ… åŠŸèƒ½éªŒè¯æ­¥éª¤**

```bash
# 1. éªŒè¯masqueradeçŠ¶æ€
firewall-cmd --query-masquerade
# åº”è¯¥è¾“å‡ºï¼šyes

# 2. éªŒè¯IPè½¬å‘
cat /proc/sys/net/ipv4/ip_forward  
# åº”è¯¥è¾“å‡ºï¼š1

# 3. éªŒè¯è½¬å‘è§„åˆ™
firewall-cmd --list-forward-ports
# åº”è¯¥çœ‹åˆ°é…ç½®çš„è½¬å‘è§„åˆ™

# 4. æŸ¥çœ‹NATè¡¨è§„åˆ™
iptables -t nat -L -n
# å¯ä»¥çœ‹åˆ°å…·ä½“çš„DNATå’ŒSNATè§„åˆ™
```

**ğŸ” ç½‘ç»œè¿é€šæ€§æµ‹è¯•**ï¼š
```bash
# ä»å¤–ç½‘æµ‹è¯•è½¬å‘åŠŸèƒ½
curl http://å…¬ç½‘IP:8080

# æ£€æŸ¥è¿æ¥çŠ¶æ€
netstat -tan | grep 8080

# æŸ¥çœ‹è¿æ¥è·Ÿè¸ª
cat /proc/net/nf_conntrack | grep 8080
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç«¯å£è½¬å‘æœ¬è´¨ï¼šç½‘ç»œæµé‡é‡å®šå‘ï¼Œå°±åƒé‚®ä»¶è½¬å‘ä¸€æ ·ç®€å•
ğŸ”¸ è½¬å‘ç±»å‹ï¼šæœ¬åœ°è½¬å‘(åŒæœåŠ¡å™¨)å’Œè¿œç¨‹è½¬å‘(ä¸åŒæœåŠ¡å™¨)  
ğŸ”¸ æ ¸å¿ƒè¯­æ³•ï¼šport=æºç«¯å£:proto=åè®®:toport=ç›®æ ‡ç«¯å£:toaddr=ç›®æ ‡IP
ğŸ”¸ NATæœºåˆ¶ï¼šmasquerade+IPè½¬å‘å®ç°åœ°å€è½¬æ¢
ğŸ”¸ å¸¸ç”¨åœºæ™¯ï¼šæœåŠ¡æ˜ å°„ã€ç«¯å£ç»Ÿä¸€ã€å®‰å…¨éš”ç¦»ã€è´Ÿè½½å‡è¡¡
```

### 8.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ æœ¬åœ°è½¬å‘è¦ç‚¹**
```
åŸºæœ¬æ ¼å¼ï¼š--add-forward-port=port=8080:proto=tcp:toport=80
é€‚ç”¨åœºæ™¯ï¼šåŒä¸€æœåŠ¡å™¨ä¸åŒç«¯å£é—´è½¬å‘
é…ç½®ç®€å•ï¼šåªéœ€æŒ‡å®šæºç«¯å£ã€åè®®ã€ç›®æ ‡ç«¯å£
```

**ğŸ”¹ è¿œç¨‹è½¬å‘è¦ç‚¹**  
```
å®Œæ•´æ ¼å¼ï¼š--add-forward-port=port=8080:proto=tcp:toaddr=192.168.1.100:toport=80
å‰ææ¡ä»¶ï¼šå¯ç”¨IPè½¬å‘ + masqueradeåŠŸèƒ½
ç½‘ç»œè¦æ±‚ï¼šç¡®ä¿ç›®æ ‡æœåŠ¡å™¨ç½‘ç»œè¿é€š
```

**ğŸ”¹ NATè½¬å‘è¦ç‚¹**
```
æ ¸å¿ƒåŠŸèƒ½ï¼šmasqueradeå®ç°åœ°å€è½¬æ¢
ç³»ç»Ÿé…ç½®ï¼šnet.ipv4.ip_forward = 1
éªŒè¯æ–¹æ³•ï¼šæŸ¥çœ‹iptables natè¡¨è§„åˆ™
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ’¡ æœ€ä½³å®è·µ**
- âœ… **è§„åˆ™ç®¡ç†**ï¼šä½¿ç”¨`--permanent`å‚æ•°æŒä¹…åŒ–é…ç½®
- âœ… **å®‰å…¨è€ƒè™‘**ï¼šåªå¼€æ”¾å¿…è¦çš„ç«¯å£ï¼Œä½¿ç”¨å¯Œè§„åˆ™é™åˆ¶è®¿é—®
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…ä¸å¿…è¦çš„å¤šå±‚è½¬å‘
- âœ… **ç›‘æ§å‘Šè­¦**ï¼šå®šæœŸæ£€æŸ¥è½¬å‘è§„åˆ™æœ‰æ•ˆæ€§

**âš ï¸ æ³¨æ„äº‹é¡¹**
- â— **é˜²ç«å¢™ä¾èµ–**ï¼šè½¬å‘åŠŸèƒ½ä¾èµ–firewalldæœåŠ¡æ­£å¸¸è¿è¡Œ
- â— **ç½‘ç»œå®‰å…¨**ï¼šç«¯å£è½¬å‘å¯èƒ½å¸¦æ¥å®‰å…¨é£é™©ï¼Œéœ€è°¨æ…é…ç½®
- â— **æ€§èƒ½å½±å“**ï¼šå¤§é‡è½¬å‘è§„åˆ™å¯èƒ½å½±å“ç½‘ç»œæ€§èƒ½
- â— **æ•…éšœæ’æŸ¥**ï¼šæŒ‰ç…§åˆ†æ­¥æ’æŸ¥æµç¨‹ç³»ç»Ÿæ€§è§£å†³é—®é¢˜

### 8.4 å®ç”¨å‘½ä»¤é€ŸæŸ¥


**ğŸš€ å¸¸ç”¨å‘½ä»¤æ¸…å•**

```bash
# æŸ¥çœ‹è½¬å‘è§„åˆ™
firewall-cmd --list-forward-ports

# æ·»åŠ æœ¬åœ°è½¬å‘
firewall-cmd --add-forward-port=port=8080:proto=tcp:toport=80

# æ·»åŠ è¿œç¨‹è½¬å‘  
firewall-cmd --add-forward-port=port=8080:proto=tcp:toaddr=192.168.1.100:toport=80

# å¯ç”¨NATè½¬å‘
firewall-cmd --add-masquerade
echo 1 > /proc/sys/net/ipv4/ip_forward

# æ°¸ä¹…ç”Ÿæ•ˆ
firewall-cmd --permanent [è§„åˆ™]
firewall-cmd --reload

# åˆ é™¤è§„åˆ™
firewall-cmd --remove-forward-port=[è§„åˆ™]

# æ•…éšœæ’æŸ¥
firewall-cmd --query-forward-port=[è§„åˆ™]
netstat -tunlp | grep [ç«¯å£]
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ç«¯å£è½¬å‘åƒè½¬ä¿¡ï¼Œæºç«¯å£è½¬åˆ°ç›®æ ‡é—¨
- æœ¬åœ°è½¬å‘åŒæœåŠ¡å™¨ï¼Œè¿œç¨‹è½¬å‘è·¨ç½‘ç»œ  
- NATè½¬å‘è¦å¼€å¯ï¼ŒmasqueradeåŠ è½¬å‘
- è§„åˆ™è¯­æ³•è¦è®°ç‰¢ï¼Œæ°¸ä¹…é…ç½®åˆ«å¿˜æ‰