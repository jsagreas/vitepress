---
title: 4、firewalld安装与初始化
---
## 📚 目录

1. [Firewalld基础概念](#1-firewalld基础概念)
2. [软件包安装](#2-软件包安装)
3. [服务管理操作](#3-服务管理操作)
4. [与iptables冲突处理](#4-与iptables冲突处理)
5. [初始配置验证](#5-初始配置验证)
6. [基础连通性测试](#6-基础连通性测试)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔥 Firewalld基础概念


### 1.1 什么是Firewalld


**🔸 通俗理解**
```
把Firewalld想象成你家的门卫：
- 门卫负责检查进出的人员(数据包)
- 根据规则决定是否放行
- 可以设置不同的安全级别
- 比传统门卫(iptables)更智能、更好管理
```

**🔸 核心特点**
- **动态管理**: 修改规则时不需要重启服务，立即生效
- **区域概念**: 根据网络环境划分不同的安全区域
- **图形界面**: 提供GUI工具，比命令行更直观
- **向下兼容**: 底层仍然使用iptables，但提供更高级的管理方式

### 1.2 Firewalld vs Iptables对比


| 特性对比 | **Firewalld** | **Iptables** | **通俗说明** |
|---------|---------------|--------------|-------------|
| 🔧 **管理方式** | `动态管理` | `静态管理` | `firewalld像智能门禁，iptables像手动门锁` |
| 🎯 **规则修改** | `即时生效` | `需要重启` | `firewalld改规则不用重启，iptables要重启` |
| 📊 **复杂度** | `简单易用` | `学习门槛高` | `firewalld对新手友好，iptables需要深度学习` |
| 🌐 **区域概念** | `支持区域` | `无区域概念` | `firewalld可以设置家庭/办公室不同模式` |

### 1.3 Firewalld工作原理


```
用户操作 ──▶ firewalld服务 ──▶ iptables规则 ──▶ 内核netfilter
   │              │               │                │
   │              │               │                │
firewall-cmd   GUI工具         真正的规则        实际过滤
命令行工具     图形界面        底层实现          数据包
```

**💡 简单理解**: Firewalld就是给iptables穿了一件"智能外套"，让复杂的防火墙管理变得简单。

---

## 2. 📦 软件包安装


### 2.1 检查系统版本


> 💡 **重要提示**  
> Firewalld主要用于RHEL7/CentOS7及以上版本，是新一代防火墙管理工具。

**🔍 查看系统版本**
```bash
# 查看系统版本信息

cat /etc/redhat-release
# 或者

hostnamectl
```

### 2.2 安装Firewalld


**🔸 YUM方式安装（推荐）**
```bash
# 安装firewalld主程序

sudo yum install -y firewalld

# 同时安装图形界面工具（可选）

sudo yum install -y firewall-config
```

**🔸 安装验证**
```bash
# 检查是否安装成功

rpm -qa | grep firewalld

# 查看安装的文件位置

rpm -ql firewalld
```

**预期结果示例**:
```
firewalld-0.6.3-13.el7_9.noarch
firewall-config-0.6.3-13.el7_9.noarch
```

### 2.3 相关软件包说明


| 软件包名称 | **作用说明** | **是否必需** | **使用场景** |
|-----------|-------------|-------------|-------------|
| 🔸 **firewalld** | `核心服务程序` | `必须安装` | `命令行管理防火墙` |
| 🔸 **firewall-config** | `图形界面工具` | `可选安装` | `桌面环境下图形管理` |
| 🔸 **python-firewall** | `Python接口库` | `自动依赖` | `编程接口支持` |

---

## 3. ⚙️ 服务管理操作


### 3.1 Systemd服务管理基础


> 🧠 **记忆要点**  
> 现代Linux系统用systemd管理服务，就像Windows的服务管理器，可以启动/停止/重启各种系统服务。

**🔸 基本服务操作命令**
```bash
# 启动firewalld服务

sudo systemctl start firewalld

# 停止firewalld服务  

sudo systemctl stop firewalld

# 重启firewalld服务

sudo systemctl restart firewalld

# 重新加载配置文件

sudo systemctl reload firewalld
```

### 3.2 开机自启配置


**🔸 设置开机自启**
```bash
# 启用开机自启动

sudo systemctl enable firewalld

# 同时启动服务并设置自启

sudo systemctl enable --now firewalld
```

**🔸 取消开机自启**
```bash
# 禁用开机自启动

sudo systemctl disable firewalld
```

### 3.3 服务状态检查


**🔸 查看服务状态**
```bash
# 详细状态信息

sudo systemctl status firewalld

# 简单状态检查

sudo systemctl is-active firewalld
sudo systemctl is-enabled firewalld
```

**状态解读**:
```
🟢 active (running) ── 服务正在运行
🟡 inactive (dead) ── 服务已停止  
🔴 failed ─────────── 服务启动失败
🔵 enabled ────────── 开机自启已启用
⚪ disabled ───────── 开机自启已禁用
```

### 3.4 服务管理最佳实践


**🚀 推荐操作顺序**
```
1️⃣ 检查当前状态 → systemctl status firewalld
2️⃣ 启动服务 ────→ systemctl start firewalld  
3️⃣ 设置自启 ────→ systemctl enable firewalld
4️⃣ 验证状态 ────→ systemctl is-active firewalld
```

---

## 4. ⚔️ 与iptables冲突处理


### 4.1 冲突原因解释


**🤔 为什么会冲突？**
```
想象一个厨房：
- iptables = 传统厨师，有固定的做菜方式
- firewalld = 现代厨师，用新式设备和方法
- 两个厨师同时操作同一个灶台，必然会出问题

技术角度：
- 两者都要控制同一套内核规则(netfilter)
- 同时运行会产生规则冲突
- 导致网络连接异常或防火墙失效
```

### 4.2 检查冲突状态


**🔍 检查方法**
```bash
# 检查iptables服务状态

sudo systemctl status iptables
sudo systemctl status ip6tables

# 检查firewalld服务状态  

sudo systemctl status firewalld

# 查看当前生效的规则

sudo iptables -L -n
```

### 4.3 解决冲突的方法


**🔸 方法一：停用iptables（推荐）**
```bash
# 停止iptables相关服务

sudo systemctl stop iptables
sudo systemctl stop ip6tables

# 禁用开机自启

sudo systemctl disable iptables  
sudo systemctl disable ip6tables

# 启动firewalld

sudo systemctl start firewalld
sudo systemctl enable firewalld
```

**🔸 方法二：卸载iptables服务**
```bash
# 如果不需要iptables，可以直接卸载

sudo yum remove iptables-services
```

### 4.4 验证冲突解决


**✅ 验证步骤**
```bash
# 1. 确认只有firewalld在运行

sudo systemctl is-active iptables    # 应该显示inactive
sudo systemctl is-active firewalld   # 应该显示active

# 2. 检查防火墙规则

sudo firewall-cmd --state            # 应该显示running

# 3. 查看当前区域

sudo firewall-cmd --get-default-zone
```

> ⚠️ **重要提醒**  
> 处理冲突时要小心，建议在测试环境先操作，避免在生产环境直接修改导致网络中断。

---

## 5. 🔧 初始配置验证


### 5.1 基础状态检查


**🔸 服务状态验证**
```bash
# 检查firewalld运行状态

sudo firewall-cmd --state

# 查看版本信息

firewall-cmd --version

# 检查配置文件位置

ls -la /etc/firewalld/
```

**预期正常输出**:
```
running                    # --state 命令输出
0.6.3                     # --version 命令输出  
drwxr-x--- 4 root root    # 配置目录存在
```

### 5.2 默认区域配置


**🔸 区域概念理解**
```
区域就像不同的安全模式：

🏠 home(家庭)     ── 高信任度，允许大部分服务
🏢 work(工作)     ── 中等信任度，允许基本办公服务  
🌐 public(公共)   ── 低信任度，只允许必要服务
🔒 drop(丢弃)     ── 最严格，丢弃所有incoming连接
```

**🔍 检查默认区域**
```bash
# 查看当前默认区域

sudo firewall-cmd --get-default-zone

# 查看所有可用区域

sudo firewall-cmd --get-zones

# 查看活动区域

sudo firewall-cmd --get-active-zones
```

### 5.3 网络接口绑定验证


**🔸 接口绑定检查**
```bash
# 查看网络接口绑定情况

sudo firewall-cmd --get-active-zones

# 查看指定区域的接口

sudo firewall-cmd --zone=public --list-interfaces

# 查看所有网络接口

ip link show
```

### 5.4 初始规则状态


**🔸 默认规则检查**
```bash
# 查看默认区域允许的服务

sudo firewall-cmd --list-services

# 查看开放的端口

sudo firewall-cmd --list-ports

# 查看所有配置信息

sudo firewall-cmd --list-all
```

**典型默认配置示例**:
```
services: ssh dhcpv6-client
ports: 
protocols: 
masquerade: no
forward-ports: 
source-ports: 
icmp-blocks: 
rich rules:
```

> 💡 **理解要点**  
> 默认情况下，firewalld通常只开放SSH服务，这保证了基本的远程管理能力，同时维持较高的安全性。

---

## 6. 🔌 基础连通性测试


### 6.1 本地连通性测试


**🔸 回环接口测试**
```bash
# 测试本地回环

ping -c 3 127.0.0.1
ping -c 3 localhost

# 检查本地服务端口

ss -tuln | grep :22    # SSH端口
ss -tuln | grep :80    # HTTP端口（如果有web服务）
```

### 6.2 网络连通性测试


**🔸 外部连通测试**
```bash
# 测试DNS解析和外网连通性

ping -c 3 8.8.8.8
ping -c 3 www.baidu.com

# 测试特定端口连通性

telnet www.baidu.com 80
# 或者使用nc命令

nc -zv www.baidu.com 80
```

### 6.3 SSH服务测试


**🔸 SSH连接测试**
```bash
# 本机SSH测试

ssh localhost

# 从其他机器测试（替换为实际IP）

ssh username@your_server_ip

# 检查SSH服务状态

sudo systemctl status sshd
```

### 6.4 防火墙规则测试


**🔸 规则生效验证**
```bash
# 临时关闭防火墙测试

sudo systemctl stop firewalld

# 测试连接（此时应该能连接）

# ... 进行连接测试 ...


# 重新启动防火墙

sudo systemctl start firewalld

# 再次测试连接（验证规则是否正确）

```

### 6.5 常见连通性问题排查


**🔍 问题排查步骤**

```
连接问题排查流程：

1️⃣ 检查服务状态 ──▶ systemctl status firewalld
2️⃣ 检查端口开放 ──▶ firewall-cmd --list-ports  
3️⃣ 检查服务允许 ──▶ firewall-cmd --list-services
4️⃣ 检查网络接口 ──▶ firewall-cmd --get-active-zones
5️⃣ 查看详细日志 ──▶ journalctl -u firewalld
```

**常见问题及解决**:

| 问题现象 | **可能原因** | **解决方法** | **验证命令** |
|---------|-------------|-------------|-------------|
| 🔴 **SSH连接失败** | `SSH服务未开放` | `firewall-cmd --add-service=ssh` | `ssh localhost` |
| 🔴 **Web访问失败** | `HTTP端口未开放` | `firewall-cmd --add-port=80/tcp` | `curl localhost` |
| 🔴 **完全无法连接** | `防火墙过于严格` | `检查默认区域设置` | `firewall-cmd --list-all` |

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本操作


```
🔸 安装命令: yum install -y firewalld
🔸 启动服务: systemctl start firewalld  
🔸 设置自启: systemctl enable firewalld
🔸 检查状态: systemctl status firewalld
🔸 基本配置: firewall-cmd --list-all
```

### 7.2 关键理解要点


**🔹 Firewalld的本质**
```
Firewalld = iptables的智能管理器
- 底层还是iptables在工作
- 提供更简单的管理方式
- 支持动态修改规则
- 引入区域概念便于管理
```

**🔹 服务管理要点**
```
systemctl 四大基本操作：
- start/stop: 启动/停止服务
- enable/disable: 开机自启控制
- status: 查看服务状态
- restart/reload: 重启/重载服务
```

**🔹 冲突处理原则**
```
一个系统只能有一个防火墙管理工具：
- 要么用iptables
- 要么用firewalld  
- 不能同时使用
- 新系统推荐firewalld
```

### 7.3 实际应用价值


**🎯 生产环境应用**
- **服务器安全**: 作为第一道防线保护服务器
- **网络隔离**: 通过区域实现不同安全级别
- **动态管理**: 无需重启即可修改规则
- **简化运维**: 降低防火墙管理复杂度

**🎯 学习进阶方向**
- 深入理解区域概念和应用
- 掌握端口和服务管理
- 学习富规则(rich rules)配置
- 了解防火墙性能优化

### 7.4 记忆要点


**🧠 核心记忆口诀**
```
firewalld装系统，systemctl管服务
enable设自启，status查状态  
iptables要冲突，stop掉旧服务
list-all查配置，zone区域要明细
```

**🔧 常用命令记忆**
```
安装: yum install firewalld
启动: systemctl start firewalld
自启: systemctl enable firewalld  
状态: firewall-cmd --state
配置: firewall-cmd --list-all
```

> 💡 **学习建议**  
> Firewalld的安装和初始化是基础中的基础，必须熟练掌握。建议多在虚拟机环境练习，确保每个命令都能正确执行并理解其作用。