---
title: 2、zones区域概念与分类
---
## 📚 目录

1. [Zone区域基础概念](#1-Zone区域基础概念)
2. [预定义Zone类型详解](#2-预定义Zone类型详解)
3. [Zone优先级与匹配规则](#3-Zone优先级与匹配规则)
4. [默认Zone管理](#4-默认Zone管理)
5. [Zone配置文件系统](#5-Zone配置文件系统)
6. [自定义Zone创建](#6-自定义Zone创建)
7. [Zone接口绑定机制](#7-Zone接口绑定机制)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌐 Zone区域基础概念


### 1.1 什么是Zone区域


**🔸 Zone的本质理解**

Zone（区域）就像是给网络接口贴上不同的"身份标签"，每个标签决定了这个网络接口能接受什么样的网络连接。

```
想象一个办公楼的场景：
🏢 办公楼（服务器）
├── 🚪 前台区域（public zone）    - 访客可以进入
├── 🏠 内部办公区（internal zone） - 员工可以进入  
├── 🛡️ 安全机房（dmz zone）      - 特殊权限才能进入
└── 🚫 绝密区域（drop zone）     - 禁止任何人进入
```

**核心作用**：
- **网络分区**：将不同的网络接口划分到不同安全级别的区域
- **规则集合**：每个zone包含一套预配置的防火墙规则
- **简化管理**：不用为每个接口单独配置规则，选择合适的zone即可

### 1.2 Zone工作原理


**🔧 Zone如何工作**

```
网络数据包进入流程：
外部请求 → 网络接口 → 检查接口所属Zone → 应用Zone规则 → 允许/拒绝

具体示例：
SSH连接请求 → eth0网卡 → public zone → 检查SSH服务规则 → 允许22端口
```

**Zone与接口的关系**：
- 每个网络接口（如eth0、wlan0）只能属于一个zone
- 一个zone可以包含多个网络接口
- 没有明确分配zone的接口会使用默认zone

### 1.3 Zone的组成要素


**📋 Zone包含的配置元素**

| 配置项 | **说明** | **示例** |
|--------|----------|----------|
| **服务（Services）** | `允许的预定义服务` | `ssh, http, https` |
| **端口（Ports）** | `允许的特定端口` | `8080/tcp, 9000/udp` |
| **协议（Protocols）** | `允许的网络协议` | `icmp, igmp` |
| **源地址（Sources）** | `允许的来源IP段` | `192.168.1.0/24` |
| **接口（Interfaces）** | `绑定的网络接口` | `eth0, wlan0` |
| **转发规则** | `端口转发和地址伪装` | `SNAT, DNAT` |

---

## 2. 🏷️ 预定义Zone类型详解


Firewalld预定义了9个不同安全级别的zone，从最严格到最宽松排列：

### 2.1 drop（丢弃区域）⛔


**🚫 最严格的安全级别**

**特点**：
- **静默拒绝**：所有入站数据包直接丢弃，不返回任何响应
- **只允许出站**：仅允许本机发起的出站连接
- **无服务开放**：不开放任何服务或端口

**适用场景**：
```
🎯 使用场景：
• 高安全要求的服务器
• 临时隔离可疑网络接口  
• 阻断恶意攻击时的应急措施

⚠️ 注意事项：
• 一旦设置，远程SSH连接会断开
• 需要物理访问或带外管理来恢复
```

### 2.2 block（阻塞区域）🚫


**🛑 严格拒绝级别**

**与drop的区别**：
- **主动拒绝**：拒绝连接并返回`icmp-host-prohibited`消息
- **有响应**：让发送方知道连接被拒绝，而不是超时等待
- **同样严格**：除响应方式外，安全级别与drop相同

**适用场景**：需要明确告知外部访问被拒绝的环境

### 2.3 public（公共区域）🌐


**📡 默认的公网环境zone**

**核心特点**：
```
🔓 预开放服务：
• SSH (22/tcp) - 远程管理
• DHCPv6-client - 自动获取IPv6地址

🔒 安全策略：
• 默认拒绝所有其他入站连接
• 适合不信任的网络环境
• 最常用的zone类型
```

**配置示例**：
```bash
# 查看public zone配置
sudo firewall-cmd --zone=public --list-all

# 输出示例：
public (active)
  target: default
  interfaces: eth0
  services: ssh dhcpv6-client
  ports: 
  protocols: 
  masquerade: no
```

### 2.4 external（外部区域）🌍


**🔗 NAT网关专用zone**

**核心特点**：
- **启用地址伪装**：自动启用MASQUERADE（NAT功能）
- **基础服务**：预开放SSH服务
- **路由器模式**：适合作为网络边界设备

**使用场景**：
```
🏠 家庭路由器：
外网接口 → external zone → 启用NAT → 内网设备共享上网

🏢 企业网关：
公网接口 → external zone → 地址转换 → 内部网络访问互联网
```

### 2.5 dmz（非军事区）🛡️


**🏢 服务器托管区域**

**DMZ概念解释**：
DMZ就像是办公楼的前台接待区域，对外提供有限的服务，但不能访问内部核心区域。

```
网络拓扑示例：
Internet → 防火墙 → DMZ区域 → Web服务器
                    ↓         Mail服务器  
                  内网 → 数据库服务器
```

**特点**：
- **预开放SSH**：方便远程管理
- **有限信任**：比public稍微信任，但仍需谨慎
- **服务导向**：适合放置面向公众的服务器

### 2.6 work（工作区域）💼


**👥 办公网络环境**

**设计理念**：
- **中等信任度**：信任网络中的大部分计算机
- **协作导向**：预开放常用的办公协作服务
- **便利性平衡**：在安全和便利之间取平衡

**预开放服务**：
```
📋 默认服务：
• SSH - 远程管理
• DHCPv6-client - 网络配置
• IPP-client - 网络打印
```

### 2.7 home（家庭区域）🏠


**🏡 家庭网络环境**

**特点**：
- **高信任度**：信任网络中的其他设备
- **便利优先**：预开放多种家庭常用服务
- **设备互联**：方便家庭设备间的互联互通

**预开放服务**：
```
📱 家庭服务：
• SSH - 远程管理
• DHCPv6-client - 网络配置  
• IPP-client - 网络打印
• Samba-client - 文件共享
• MDNS - 设备发现
```

### 2.8 internal（内部区域）🔒


**🏢 内网核心区域**

**安全定位**：
- **最高信任度**：完全信任网络中的设备
- **内网专用**：仅用于隔离的内部网络
- **服务丰富**：预开放最多的服务类型

**预开放服务**：与home区域相同，但安全定位更严格

### 2.9 trusted（信任区域）✅


**🤝 完全信任级别**

**极简策略**：
- **允许所有**：允许所有网络连接
- **无限制**：等同于关闭防火墙
- **特殊用途**：仅用于完全可信的网络环境

**使用警告**：
> ⚠️ **安全警告**
> trusted zone等同于关闭防火墙，仅在完全隔离且可信的环境中使用

---

## 3. ⚖️ Zone优先级与匹配规则


### 3.1 Zone匹配优先级


Firewalld按以下优先级顺序匹配zone：

```
Zone匹配优先级（从高到低）：
1️⃣ 源地址匹配 (Source-based zones)
2️⃣ 接口匹配 (Interface-based zones)  
3️⃣ 默认zone (Default zone)
```

**🔍 匹配过程详解**：

```
数据包到达流程：
外部请求(192.168.1.100) → eth0接口
    ↓
检查是否有源地址规则 → 192.168.1.0/24 → work zone
    ↓ (如果没有源地址规则)
检查接口所属zone → eth0 → public zone
    ↓ (如果接口未分配zone)
使用默认zone → public zone
```

### 3.2 源地址优先级示例


**🎯 实际配置场景**：

假设服务器配置如下：
- **默认zone**：public（严格策略）
- **eth0接口**：绑定到work zone（中等策略）
- **源地址规则**：192.168.1.0/24 → home zone（宽松策略）

**匹配结果**：
```
📍 不同来源的连接将匹配到不同zone：

192.168.1.50 → home zone（源地址匹配，优先级最高）
10.0.0.100   → work zone（接口匹配，优先级中等）  
8.8.8.8      → public zone（默认zone，优先级最低）
```

### 3.3 优先级配置技巧


**⚡ 最佳实践**：

```
💡 策略设计技巧：
• 默认zone设置为最严格（public/drop）
• 为可信网段配置源地址规则 
• 为特定接口配置适合的zone
• 利用优先级实现精细化访问控制
```

---

## 4. 🎯 默认Zone管理


### 4.1 查看默认Zone


**🔍 查看当前默认zone**：

```bash
# 查看默认zone
sudo firewall-cmd --get-default-zone
# 输出：public

# 查看活动的zones
sudo firewall-cmd --get-active-zones
# 输出示例：
# public
#   interfaces: eth0
```

### 4.2 设置默认Zone


**🔧 临时设置（重启后失效）**：

```bash
# 临时切换默认zone
sudo firewall-cmd --set-default-zone=home
# success

# 验证切换结果
sudo firewall-cmd --get-default-zone
# home
```

**💾 永久设置（重启后保持）**：

```bash
# 永久设置默认zone
sudo firewall-cmd --set-default-zone=work
sudo firewall-cmd --runtime-to-permanent
```

### 4.3 Zone切换影响


**⚠️ 切换zone的影响**：

| 切换方向 | **网络连接影响** | **服务可用性** | **建议操作** |
|----------|-----------------|---------------|--------------|
| `严格→宽松` | `连接不中断` | `服务增加` | `相对安全` |
| `宽松→严格` | `可能中断连接` | `服务减少` | `谨慎操作` |
| `临时切换` | `立即生效` | `重启恢复` | `测试用途` |
| `永久切换` | `立即生效` | `重启保持` | `生产使用` |

**🛡️ 安全切换建议**：

```bash
# 安全切换的标准流程
# 1. 先查看当前状态
sudo firewall-cmd --get-default-zone
sudo firewall-cmd --get-active-zones

# 2. 临时切换测试
sudo firewall-cmd --set-default-zone=work

# 3. 测试服务可用性
curl -I http://localhost
ssh user@localhost

# 4. 确认无问题后永久保存
sudo firewall-cmd --runtime-to-permanent
```

---

## 5. 📁 Zone配置文件系统


### 5.1 配置文件目录结构


**📂 Zone配置文件位置**：

```
Zone配置文件系统：
/usr/lib/firewalld/zones/     ← 系统默认zone定义
├── public.xml
├── internal.xml  
├── home.xml
└── ...

/etc/firewalld/zones/         ← 用户自定义zone配置
├── custom-zone.xml
└── modified-public.xml

配置优先级：/etc/firewalld/zones/ > /usr/lib/firewalld/zones/
```

### 5.2 Zone配置文件格式


**📄 XML配置文件结构**：

```xml
<?xml version="1.0" encoding="utf-8"?>
<zone>
  <short>Public</short>
  <description>公共区域配置描述</description>
  
  <!-- 预定义服务 -->
  <service name="ssh"/>
  <service name="dhcpv6-client"/>
  
  <!-- 自定义端口 -->
  <port protocol="tcp" port="8080"/>
  <port protocol="udp" port="9000"/>
  
  <!-- 允许的协议 -->
  <protocol value="icmp"/>
  
  <!-- 源地址限制 -->
  <source address="192.168.1.0/24"/>
</zone>
```

**🔧 配置文件说明**：

| XML元素 | **功能说明** | **示例** |
|---------|-------------|----------|
| `<short>` | `Zone简短名称` | `Public Zone` |
| `<description>` | `详细描述信息` | `适用于公共网络环境` |
| `<service>` | `预定义服务` | `ssh, http, mysql` |
| `<port>` | `自定义端口` | `8080/tcp, 9000/udp` |
| `<protocol>` | `网络协议` | `icmp, igmp` |
| `<source>` | `源地址` | `192.168.1.0/24` |

### 5.3 查看Zone配置


**🔍 查看zone详细配置**：

```bash
# 查看指定zone的完整配置
sudo firewall-cmd --zone=public --list-all

# 查看所有zone的配置
sudo firewall-cmd --list-all-zones

# 查看zone的XML配置文件
sudo cat /usr/lib/firewalld/zones/public.xml
```

---

## 6. 🛠️ 自定义Zone创建


### 6.1 创建自定义Zone


**🎨 创建新的zone**：

```bash
# 创建名为"web-server"的新zone
sudo firewall-cmd --permanent --new-zone=web-server

# 重新加载配置使其生效
sudo firewall-cmd --reload

# 验证zone创建成功
sudo firewall-cmd --get-zones
```

### 6.2 配置自定义Zone


**⚙️ 为自定义zone配置规则**：

```bash
# 为web-server zone添加基础服务
sudo firewall-cmd --permanent --zone=web-server --add-service=ssh
sudo firewall-cmd --permanent --zone=web-server --add-service=http
sudo firewall-cmd --permanent --zone=web-server --add-service=https

# 添加自定义端口
sudo firewall-cmd --permanent --zone=web-server --add-port=8080/tcp

# 设置zone描述信息
sudo firewall-cmd --permanent --zone=web-server --set-description="Web服务器专用zone"
sudo firewall-cmd --permanent --zone=web-server --set-short="WebServer"

# 重新加载配置
sudo firewall-cmd --reload
```

### 6.3 自定义Zone最佳实践


**📋 Zone设计原则**：

```
💡 命名规范：
• 使用有意义的名称（如web-server、database、office）
• 避免使用特殊字符和空格
• 采用统一的命名约定

🎯 功能定位：
• 每个zone有明确的使用场景
• 遵循最小权限原则
• 定期审查和更新规则

📝 文档记录：
• 记录zone的用途和适用场景
• 维护配置变更历史
• 建立zone使用规范
```

**自定义zone配置示例**：

```bash
# 创建数据库服务器zone
sudo firewall-cmd --permanent --new-zone=database
sudo firewall-cmd --permanent --zone=database --add-service=ssh
sudo firewall-cmd --permanent --zone=database --add-service=mysql
sudo firewall-cmd --permanent --zone=database --add-source=192.168.10.0/24
sudo firewall-cmd --reload
```

---

## 7. 🔗 Zone接口绑定机制


### 7.1 查看接口zone绑定


**🔍 查看当前接口分配**：

```bash
# 查看所有接口的zone分配
sudo firewall-cmd --get-active-zones

# 查看特定接口属于哪个zone
sudo firewall-cmd --get-zone-of-interface=eth0

# 查看指定zone包含哪些接口
sudo firewall-cmd --zone=public --list-interfaces
```

### 7.2 接口zone绑定操作


**🔧 绑定接口到zone**：

```bash
# 临时将接口绑定到zone（重启后失效）
sudo firewall-cmd --zone=work --add-interface=eth1

# 永久绑定接口到zone
sudo firewall-cmd --permanent --zone=work --add-interface=eth1
sudo firewall-cmd --reload

# 从zone中移除接口
sudo firewall-cmd --permanent --zone=work --remove-interface=eth1
sudo firewall-cmd --reload
```

### 7.3 接口绑定场景


**🏢 多接口服务器配置示例**：

```
服务器网络配置：
eth0 (10.0.1.100)    → public zone   (外网接口，严格策略)
eth1 (192.168.1.100) → internal zone (内网接口，宽松策略)  
eth2 (172.16.1.100)  → dmz zone      (DMZ接口，中等策略)

实现目的：
• 外网访问受限，仅开放必要服务
• 内网访问便利，开放协作服务
• DMZ提供公共服务，适度开放
```

**配置命令序列**：

```bash
# 配置多接口zone绑定
sudo firewall-cmd --permanent --zone=public --add-interface=eth0
sudo firewall-cmd --permanent --zone=internal --add-interface=eth1  
sudo firewall-cmd --permanent --zone=dmz --add-interface=eth2

# 重新加载配置
sudo firewall-cmd --reload

# 验证配置结果
sudo firewall-cmd --get-active-zones
```

### 7.4 动态接口管理


**📱 无线网络场景**：

在笔记本电脑等移动设备中，网络接口可能动态变化：

```bash
# 设置智能的默认zone策略
sudo firewall-cmd --set-default-zone=public

# 为家庭WiFi配置源地址规则  
sudo firewall-cmd --permanent --zone=home --add-source=192.168.1.0/24

# 为办公WiFi配置源地址规则
sudo firewall-cmd --permanent --zone=work --add-source=10.0.0.0/8

# 这样无论连接哪个WiFi，都会自动匹配合适的zone
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 Zone本质：网络接口的安全标签，决定防火墙规则集
🔸 预定义Zone：9种不同安全级别，从drop到trusted
🔸 优先级规则：源地址 > 接口绑定 > 默认zone
🔸 配置持久化：临时配置vs永久配置的区别
🔸 接口绑定：一个接口只能属于一个zone
🔸 自定义Zone：根据实际需求创建专用zone
```

### 8.2 Zone选择指导原则


**🎯 Zone选择决策树**：

```
网络环境评估：
├─ 完全不信任 → drop/block zone
├─ 公网环境   → public zone (默认推荐)
├─ 办公网络   → work zone  
├─ 家庭网络   → home zone
├─ 内部网络   → internal zone
└─ 完全可信   → trusted zone (谨慎使用)

特殊用途：
├─ NAT网关    → external zone
├─ Web服务器  → dmz zone
└─ 自定义需求 → 创建custom zone
```

### 8.3 实际应用最佳实践


**💡 Zone管理最佳实践**：

```
📋 规划原则：
• 默认使用public zone，确保基础安全
• 根据网络信任度选择合适的zone
• 利用源地址规则实现精细化控制
• 为不同用途的服务器创建专用zone

🔧 操作建议：
• 配置更改前先备份当前配置
• 使用临时配置测试，确认后再永久保存
• 定期审查zone规则，移除不必要的开放
• 建立zone使用文档和变更记录

⚠️ 安全提醒：
• 避免直接使用trusted zone
• 切换zone前确保不会中断关键服务
• 多接口服务器要仔细规划zone分配
• 定期检查活动zone和接口绑定状况
```

### 8.4 常用命令速查


```bash
# Zone基础操作
sudo firewall-cmd --get-zones                    # 查看所有zone
sudo firewall-cmd --get-default-zone             # 查看默认zone
sudo firewall-cmd --get-active-zones             # 查看活动zone
sudo firewall-cmd --zone=public --list-all       # 查看zone详情

# Zone管理
sudo firewall-cmd --set-default-zone=work        # 设置默认zone
sudo firewall-cmd --permanent --new-zone=custom  # 创建新zone
sudo firewall-cmd --reload                       # 重新加载配置

# 接口绑定
sudo firewall-cmd --get-zone-of-interface=eth0        # 查看接口zone
sudo firewall-cmd --zone=public --add-interface=eth0  # 绑定接口到zone
```

**核心记忆**：
- Zone是防火墙规则的容器，为网络接口贴上安全标签
- 优先级顺序：源地址匹配 > 接口绑定 > 默认zone
- 选择原则：根据网络信任度选择，默认public最安全
- 操作建议：先临时测试，确认无误后再永久保存