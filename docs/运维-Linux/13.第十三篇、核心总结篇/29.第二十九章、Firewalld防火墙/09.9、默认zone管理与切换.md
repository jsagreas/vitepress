---
title: 9、默认zone管理与切换
---
## 📚 目录

1. [默认zone基本概念](#1-默认zone基本概念)
2. [默认zone查询方法](#2-默认zone查询方法)
3. [默认zone设置与变更](#3-默认zone设置与变更)
4. [zone切换影响范围](#4-zone切换影响范围)
5. [临时zone变更操作](#5-临时zone变更操作)
6. [zone切换验证方法](#6-zone切换验证方法)
7. [zone恢复默认配置](#7-zone恢复默认配置)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 默认zone基本概念


### 1.1 什么是默认zone


**🔸 核心定义**
```
默认zone（Default Zone）：
系统启动时自动激活的防火墙区域
新的网络接口会自动分配到这个区域
是firewalld的"入口大门"设置
```

**💡 通俗理解**
想象你家有多个房间，每个房间有不同的安全级别：
```
客厅(public) ← 默认区域，外人进来先到这里
卧室(home)   ← 家人专用，安全级别高  
书房(work)   ← 工作专用，有特定规则
厨房(drop)   ← 禁区，什么都不允许
```

默认zone就是**客厅**，外来连接首先进入的地方。

### 1.2 默认zone的重要性


**🌟 关键作用**
- **🚪 入口控制**：所有新连接的第一道门槛
- **📋 规则基础**：决定了基本的防火墙策略  
- **⚙️ 系统默认**：影响整个系统的网络安全态势
- **🔄 动态调整**：可以根据环境需要灵活切换

**⚠️ 重要提醒**
> 默认zone设置直接影响系统安全性，切换前要明确新zone的规则限制

### 1.3 常见zone类型回顾


| Zone名称 | **安全等级** | **典型用途** | **默认规则** |
|---------|-------------|-------------|-------------|
| 🔓 **trusted** | `极宽松` | `完全信任网络` | `所有流量通过` |
| 🏠 **home** | `宽松` | `家庭网络` | `允许常用服务` |
| 🏢 **work** | `中等` | `办公网络` | `允许工作相关服务` |
| 🌐 **public** | `严格` | `公共网络` | `仅允许必要服务` |
| 🚫 **drop** | `最严格` | `高安全场景` | `丢弃所有入站` |

---

## 2. 🔍 默认zone查询方法


### 2.1 基础查询命令


**🔸 查看当前默认zone**
```bash
firewall-cmd --get-default-zone
```

**实际操作示例**
```bash
[root@server ~]# firewall-cmd --get-default-zone
public
```

**💭 命令含义解释**
- `--get-default-zone`：获取系统当前设定的默认区域
- 返回结果：显示当前默认zone名称
- **作用**：确认系统当前的安全策略基准

### 2.2 详细zone信息查询


**🔸 查看所有可用zone**
```bash
firewall-cmd --get-zones
```

**🔸 查看当前活动zone**
```bash
firewall-cmd --get-active-zones
```

**实操对比示例**
```bash
# 查看所有zone
[root@server ~]# firewall-cmd --get-zones
block dmz drop external home internal public trusted work

# 查看活动zone（正在使用的）
[root@server ~]# firewall-cmd --get-active-zones
public
  interfaces: eth0 eth1
```

**📊 信息对比分析**
```
可用zone    ：系统中已配置的所有区域模板
活动zone    ：当前正在使用的区域（有网络接口分配）
默认zone    ：新接口自动分配的目标区域
```

### 2.3 网络接口zone分配查询


**🔸 查看网络接口的zone分配**
```bash
firewall-cmd --list-all-zones | grep -A 5 "interfaces"
```

**🔸 查看特定接口所属zone**
```bash
firewall-cmd --get-zone-of-interface=eth0
```

**实际查看示例**
```bash
[root@server ~]# firewall-cmd --get-zone-of-interface=eth0
public

[root@server ~]# firewall-cmd --get-zone-of-interface=lo
no zone
```

**🔹 结果说明**
- **有zone返回**：该接口已分配到具体zone
- **"no zone"**：该接口使用默认zone设置
- **环回接口(lo)**：通常不分配zone，使用默认规则

---

## 3. ⚙️ 默认zone设置与变更


### 3.1 永久变更默认zone


**🔸 设置新的默认zone**
```bash
firewall-cmd --set-default-zone=home
```

**操作步骤详解**
```bash
# 步骤1：查看当前默认zone
[root@server ~]# firewall-cmd --get-default-zone
public

# 步骤2：设置新的默认zone
[root@server ~]# firewall-cmd --set-default-zone=home
success

# 步骤3：验证变更结果
[root@server ~]# firewall-cmd --get-default-zone
home
```

**⚡ 变更立即生效**
> 🔥 **重点**：`--set-default-zone` 命令立即永久生效，无需reload

### 3.2 变更前的安全检查


**📋 变更前必做检查**
1. **了解目标zone规则**
```bash
firewall-cmd --zone=home --list-all
```

2. **检查当前连接**
```bash
ss -tlnp | grep :22  # 检查SSH连接
```

3. **确认变更影响**
```bash
# 对比当前zone和目标zone的服务差异
firewall-cmd --zone=public --list-services
firewall-cmd --zone=home --list-services
```

**实际检查示例**
```bash
# 当前public zone允许的服务
[root@server ~]# firewall-cmd --zone=public --list-services
dhcpv6-client ssh

# home zone允许的服务  
[root@server ~]# firewall-cmd --zone=home --list-services
dhcpv6-client ipp-client mdns samba-client ssh
```

**🔍 分析结果**
- **home zone更宽松**：允许更多局域网服务
- **SSH服务保留**：不会断开远程连接
- **新增服务**：支持打印、文件共享等家庭网络功能

### 3.3 批量zone配置


**🔸 配置文件方式修改**
```bash
# 编辑firewalld配置文件
vi /etc/firewalld/firewalld.conf

# 修改默认zone设置
DefaultZone=home
```

**🔸 重启服务生效**
```bash
systemctl restart firewalld
```

**⚠️ 注意事项**
> 配置文件修改需要重启服务，会短暂中断防火墙保护

---

## 4. 🌐 zone切换影响范围


### 4.1 影响范围分析


**🔸 直接影响对象**
```
📡 网络接口
├── 未显式分配zone的接口自动使用新默认zone
├── 已显式分配zone的接口不受影响  
└── 新插入的网络设备自动使用新默认zone

🌊 网络流量
├── 入站连接按新zone规则过滤
├── 出站连接一般不受限制
└── 已建立连接保持现有状态
```

### 4.2 不同场景的影响


**📊 影响对比表**

| 网络场景 | **zone切换前** | **zone切换后** | **影响程度** |
|---------|---------------|---------------|-------------|
| 🖥️ **SSH连接** | `public允许ssh` | `home允许ssh` | `无影响` |
| 🌐 **Web服务** | `public不允许http` | `home不允许http` | `仍被阻止` |
| 📁 **文件共享** | `public不允许samba` | `home允许samba` | `新增服务` |
| 🖨️ **打印服务** | `public不允许ipp` | `home允许ipp` | `新增服务` |

### 4.3 网络接口分配规则


**🔸 接口zone分配优先级**
```
优先级排序（由高到低）：
1. 明确指定zone的接口    ← 不受默认zone影响
2. 配置文件指定的接口    ← 按配置文件设置
3. 未指定zone的接口      ← 自动使用默认zone
4. 新增的网络接口        ← 自动分配到默认zone
```

**实际验证示例**
```bash
# 显式分配eth0到work zone
firewall-cmd --permanent --zone=work --change-interface=eth0

# 切换默认zone到home
firewall-cmd --set-default-zone=home

# 检查结果
firewall-cmd --get-zone-of-interface=eth0  # 仍为work
firewall-cmd --get-default-zone            # 已变为home
```

**📝 结果解释**
- **eth0**：因为明确分配到work zone，不受默认zone切换影响
- **新接口**：如果插入新网卡，会自动分配到home zone

---

## 5. 🔄 临时zone变更操作


### 5.1 临时变更概念


**🔸 临时变更特点**
```
运行时变更：
• 立即生效，但重启后失效
• 用于测试和临时调整
• 不修改配置文件

永久变更：
• 写入配置文件
• 重启后依然有效  
• 生产环境的标准做法
```

### 5.2 临时zone切换方法


**🔸 临时切换接口zone**
```bash
# 临时将eth0分配到trusted zone
firewall-cmd --zone=trusted --change-interface=eth0

# 验证切换结果
firewall-cmd --get-zone-of-interface=eth0
```

**实际操作示例**
```bash
# 查看当前状态
[root@server ~]# firewall-cmd --get-zone-of-interface=eth0
public

# 临时切换到trusted zone
[root@server ~]# firewall-cmd --zone=trusted --change-interface=eth0
success

# 验证切换结果
[root@server ~]# firewall-cmd --get-zone-of-interface=eth0
trusted

# 查看活动zone
[root@server ~]# firewall-cmd --get-active-zones
trusted
  interfaces: eth0
```

### 5.3 临时变更的应用场景


**🎯 典型使用场景**

**📋 故障排查**
```bash
# 临时切换到trusted zone排查网络问题
firewall-cmd --zone=trusted --change-interface=eth0

# 测试完成后恢复
firewall-cmd --zone=public --change-interface=eth0
```

**🧪 新规则测试**
```bash
# 临时开放特定服务测试
firewall-cmd --zone=public --add-service=http

# 测试OK后永久添加
firewall-cmd --permanent --zone=public --add-service=http
firewall-cmd --reload
```

**🔧 维护操作**
```bash
# 维护期间临时关闭防火墙保护
firewall-cmd --zone=trusted --change-interface=eth0

# 维护完成后恢复安全设置
firewall-cmd --zone=public --change-interface=eth0
```

**⚠️ 安全提醒**
> 🔥 **重点**：临时变更常用于故障排查，但要及时恢复安全配置

---

## 6. ✅ zone切换验证方法


### 6.1 基础验证命令


**🔸 验证checklist**
```bash
# 1. 确认默认zone
firewall-cmd --get-default-zone

# 2. 确认活动zone
firewall-cmd --get-active-zones

# 3. 确认接口分配
firewall-cmd --get-zone-of-interface=eth0

# 4. 确认zone规则
firewall-cmd --list-all
```

### 6.2 功能性验证测试


**🧪 服务可达性测试**
```bash
# 测试SSH服务
telnet localhost 22

# 测试HTTP服务（如果允许）
curl -I http://localhost

# 测试特定端口
nc -zv localhost 80
```

**🔍 网络连接验证**
```bash
# 查看监听端口
ss -tlnp

# 查看established连接
ss -t state established

# 查看防火墙日志
journalctl -u firewalld -f
```

### 6.3 完整验证流程


**📋 标准验证步骤**

**步骤1：基础状态确认**
```bash
echo "=== 当前防火墙状态 ==="
firewall-cmd --state
firewall-cmd --get-default-zone
firewall-cmd --get-active-zones
```

**步骤2：规则详细检查**
```bash
echo "=== 当前zone规则 ==="
firewall-cmd --list-all
firewall-cmd --list-services
firewall-cmd --list-ports
```

**步骤3：连接功能测试**
```bash
echo "=== 连接测试 ==="
# 测试SSH（应该成功）
nc -zv localhost 22

# 测试HTTP（根据zone规则）
nc -zv localhost 80
```

**📊 验证结果判断**
- ✅ **SSH连接正常**：基本远程管理不受影响
- ✅ **预期服务可用**：新zone的服务按规则开放
- ✅ **意外服务阻止**：不在zone规则内的服务被正确阻止
- ✅ **日志记录正常**：防火墙变更有相应日志

---

## 7. 🔄 zone恢复默认配置


### 7.1 恢复系统默认zone


**🔸 恢复到系统初始默认**
```bash
# CentOS/RHEL默认为public zone
firewall-cmd --set-default-zone=public
```

### 7.2 清理zone自定义配置


**🔸 重置zone到原始状态**
```bash
# 重置特定zone的配置
firewall-cmd --permanent --zone=public --remove-service=http
firewall-cmd --permanent --zone=public --remove-port=8080/tcp

# 重载配置使生效
firewall-cmd --reload
```

**🔸 批量清理接口分配**
```bash
# 移除接口的明确zone分配，让其使用默认zone
firewall-cmd --permanent --remove-interface=eth0
firewall-cmd --reload
```

### 7.3 完全重置防火墙配置


**🔸 重置到出厂状态**
```bash
# 停止firewalld服务
systemctl stop firewalld

# 删除运行时配置
rm -rf /etc/firewalld/zones/*
rm -rf /etc/firewalld/services/*

# 重启服务，恢复默认配置
systemctl start firewalld
```

**⚠️ 重要警告**
> 🚨 **危险操作**：完全重置会丢失所有自定义配置，谨慎使用

### 7.4 备份恢复机制


**🔸 配置备份**
```bash
# 备份当前配置
cp -r /etc/firewalld/ /etc/firewalld.backup.$(date +%Y%m%d)

# 恢复配置
cp -r /etc/firewalld.backup.20250121/ /etc/firewalld/
systemctl reload firewalld
```

**💡 最佳实践**
```
变更前备份：cp -r /etc/firewalld /root/firewalld.backup
测试变更  ：执行zone切换操作
验证结果  ：确认功能正常
确认生效  ：如正常则保留，如异常则恢复备份
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 默认zone：系统启动时的防火墙入口规则，影响新接口分配
🔸 zone查询：使用--get-default-zone查看，--get-active-zones确认活动状态  
🔸 zone切换：--set-default-zone永久变更，--change-interface临时分配
🔸 影响范围：未明确分配zone的接口受影响，已分配接口不变
🔸 验证方法：检查zone状态、测试服务连通性、查看日志记录
```

### 8.2 关键操作命令速查


**🔹 查询命令**
```bash
firewall-cmd --get-default-zone              # 查看默认zone
firewall-cmd --get-active-zones              # 查看活动zone  
firewall-cmd --get-zone-of-interface=eth0    # 查看接口zone分配
```

**🔹 设置命令**  
```bash
firewall-cmd --set-default-zone=home         # 设置默认zone
firewall-cmd --zone=trusted --change-interface=eth0  # 临时分配接口
firewall-cmd --permanent --zone=work --change-interface=eth0  # 永久分配接口
```

**🔹 验证命令**
```bash
firewall-cmd --list-all                      # 查看当前zone规则
firewall-cmd --list-all-zones               # 查看所有zone配置
```

### 8.3 实际应用指导


**🎯 常见应用场景**
- **🏠 家庭网络**：使用home zone，支持文件共享、打印等服务
- **🏢 办公环境**：使用work zone，平衡安全性与功能需求  
- **🌐 公共场所**：使用public zone，严格限制服务开放
- **🔒 高安全环境**：使用drop zone，拒绝所有入站连接
- **🧪 测试环境**：使用trusted zone，便于调试和测试

**🔧 操作最佳实践**
```
变更前准备：
• 了解目标zone的规则特性
• 备份当前配置
• 确认不会影响关键服务

变更执行：
• 先临时测试，确认无问题后永久生效
• 逐步变更，避免一次性大幅调整  
• 保持SSH等管理服务可用

变更验证：
• 检查防火墙状态和zone分配
• 测试关键服务连通性
• 查看系统日志确认无异常
```

**核心记忆**：
- 默认zone是防火墙的"大门设置"，决定新连接的安全策略
- zone切换要谨慎，影响范围要心中有数
- 临时切换用于测试，永久切换用于生产
- 验证是zone管理的重要环节，确保安全性和可用性平衡