---
title: 13ã€å¯Œè§„åˆ™é…ç½®ä¸ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [å¯Œè§„åˆ™æ¦‚å¿µè§£æ](#1-å¯Œè§„åˆ™æ¦‚å¿µè§£æ)
2. [å¯Œè§„åˆ™è¯­æ³•ç»“æ„è¯¦è§£](#2-å¯Œè§„åˆ™è¯­æ³•ç»“æ„è¯¦è§£)
3. [åœ°å€é…ç½®è§„åˆ™](#3-åœ°å€é…ç½®è§„åˆ™)
4. [ç«¯å£ä¸åè®®é…ç½®](#4-ç«¯å£ä¸åè®®é…ç½®)
5. [åŠ¨ä½œç±»å‹æ·±å…¥ç†è§£](#5-åŠ¨ä½œç±»å‹æ·±å…¥ç†è§£)
6. [å¯Œè§„åˆ™ä¼˜å…ˆçº§æœºåˆ¶](#6-å¯Œè§„åˆ™ä¼˜å…ˆçº§æœºåˆ¶)
7. [å¤æ‚è§„åˆ™ç»„åˆå®æˆ˜](#7-å¤æ‚è§„åˆ™ç»„åˆå®æˆ˜)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¯Œè§„åˆ™æ¦‚å¿µè§£æ


### 1.1 ä»€ä¹ˆæ˜¯å¯Œè§„åˆ™


**é€šä¿—ç†è§£**ï¼šå¯Œè§„åˆ™ï¼ˆRich Ruleï¼‰å°±æ˜¯firewalldçš„"é«˜çº§å®šåˆ¶è§„åˆ™"ï¼Œæ¯”åŸºç¡€è§„åˆ™æ›´çµæ´»ã€æ›´ç²¾ç»†ã€‚

```
åŸºç¡€è§„åˆ™å°±åƒï¼š
"å…è®¸æ‰€æœ‰äººè®¿é—®80ç«¯å£" - ç®€å•ç²—æš´

å¯Œè§„åˆ™å°±åƒï¼š
"åªå…è®¸192.168.1.0/24ç½‘æ®µçš„ç”¨æˆ·åœ¨å·¥ä½œæ—¶é—´è®¿é—®80ç«¯å£çš„HTTPæœåŠ¡ï¼Œ
å…¶ä»–æƒ…å†µæ‹’ç»å¹¶è®°å½•æ—¥å¿—" - ç²¾ç»†æ§åˆ¶
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸ”¸ **æ›´ç²¾ç»†çš„æ§åˆ¶**ï¼šå¯ä»¥é’ˆå¯¹ç‰¹å®šIPã€ç«¯å£ã€åè®®ç»„åˆ
- ğŸ”¸ **æ›´ä¸°å¯Œçš„åŠ¨ä½œ**ï¼šé™¤äº†å…è®¸/æ‹’ç»ï¼Œè¿˜èƒ½è®°å½•æ—¥å¿—ã€é™åˆ¶è¿æ¥æ•°
- ğŸ”¸ **æ›´å¼ºçš„è¡¨è¾¾èƒ½åŠ›**ï¼šä¸€æ¡è§„åˆ™èƒ½è¡¨è¾¾å¤æ‚çš„è®¿é—®ç­–ç•¥

### 1.2 å¯Œè§„åˆ™ä¸åŸºç¡€è§„åˆ™çš„åŒºåˆ«


| **å¯¹æ¯”é¡¹ç›®** | **åŸºç¡€è§„åˆ™** | **å¯Œè§„åˆ™** |
|-------------|------------|-----------|
| **æ§åˆ¶ç²¾åº¦** | `ç²—ç²’åº¦æ§åˆ¶` | `ç»†ç²’åº¦æ§åˆ¶` |
| **é…ç½®å¤æ‚åº¦** | `ç®€å•æ˜“ç”¨` | `åŠŸèƒ½å¼ºå¤§ä½†å¤æ‚` |
| **é€‚ç”¨åœºæ™¯** | `æ—¥å¸¸åŸºç¡€éœ€æ±‚` | `å¤æ‚å®‰å…¨ç­–ç•¥` |
| **å­¦ä¹ æˆæœ¬** | `ä½` | `ä¸­ç­‰` |

### 1.3 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¯Œè§„åˆ™


**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… **ç‰¹å®šIPæ®µè®¿é—®æ§åˆ¶**ï¼šåªå…è®¸æŸäº›ç½‘æ®µè®¿é—®ç‰¹å®šæœåŠ¡
- âœ… **å¤æ‚ç«¯å£ç­–ç•¥**ï¼šåŒä¸€ç«¯å£å¯¹ä¸åŒæ¥æºæœ‰ä¸åŒå¤„ç†
- âœ… **å®‰å…¨å®¡è®¡éœ€æ±‚**ï¼šéœ€è¦è¯¦ç»†è®°å½•è®¿é—®æ—¥å¿—
- âœ… **æ”»å‡»é˜²æŠ¤**ï¼šé’ˆå¯¹ç‰¹å®šæ”»å‡»æ¨¡å¼çš„é˜²æŠ¤è§„åˆ™

**å®é™…åº”ç”¨ä¸¾ä¾‹**ï¼š
```
ä¼ä¸šåœºæ™¯ï¼š
- åŠå…¬ç½‘æ®µå¯ä»¥è®¿é—®å†…éƒ¨æœåŠ¡å™¨çš„22ç«¯å£SSH
- å¤–ç½‘IPè®¿é—®22ç«¯å£ç›´æ¥æ‹’ç»å¹¶è®°å½•
- VIPå®¢æˆ·IPå¯ä»¥è®¿é—®ç‰¹æ®ŠAPIç«¯å£
```

---

## 2. ğŸ“‹ å¯Œè§„åˆ™è¯­æ³•ç»“æ„è¯¦è§£


### 2.1 åŸºæœ¬è¯­æ³•æ¡†æ¶


å¯Œè§„åˆ™çš„è¯­æ³•ç»“æ„å°±åƒå¡«ç©ºé¢˜ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰å›ºå®šæ ¼å¼ï¼š

```
rule [family="ipv4|ipv6"]
[source address="åœ°å€" [invert="true"]]
[destination address="åœ°å€" [invert="true"]]
[service name="æœåŠ¡å"|port port="ç«¯å£" protocol="åè®®"]
[log [prefix="å‰ç¼€"] [level="çº§åˆ«"] [limit value="é€Ÿç‡"]]
[accept|reject|drop]
```

### 2.2 è¯­æ³•ç»„æˆéƒ¨åˆ†è¯¦è§£


**ğŸ”¸ family åœ°å€æ—**
- `family="ipv4"`ï¼šIPv4è§„åˆ™ï¼ˆé»˜è®¤ï¼‰
- `family="ipv6"`ï¼šIPv6è§„åˆ™

**ğŸ”¸ source/destination æ¥æº/ç›®æ ‡**
- `source address="IPåœ°å€/ç½‘æ®µ"`ï¼šæŒ‡å®šæ¥æº
- `destination address="IPåœ°å€/ç½‘æ®µ"`ï¼šæŒ‡å®šç›®æ ‡
- `invert="true"`ï¼šå–åæ“ä½œ

**ğŸ”¸ service/port æœåŠ¡/ç«¯å£**
- `service name="http"`ï¼šä½¿ç”¨é¢„å®šä¹‰æœåŠ¡
- `port port="80" protocol="tcp"`ï¼šç›´æ¥æŒ‡å®šç«¯å£

**ğŸ”¸ log æ—¥å¿—è®°å½•**
- `log`ï¼šå¯ç”¨æ—¥å¿—è®°å½•
- `prefix="è‡ªå®šä¹‰å‰ç¼€"`ï¼šæ—¥å¿—å‰ç¼€æ ‡è¯†
- `level="info"`ï¼šæ—¥å¿—çº§åˆ«
- `limit value="3/m"`ï¼šæ—¥å¿—é™é€Ÿ

**ğŸ”¸ action åŠ¨ä½œ**
- `accept`ï¼šå…è®¸é€šè¿‡
- `reject`ï¼šæ‹’ç»å¹¶è¿”å›é”™è¯¯ä¿¡æ¯
- `drop`ï¼šä¸¢å¼ƒï¼Œä¸è¿”å›ä»»ä½•ä¿¡æ¯

### 2.3 è¯­æ³•ç†è§£æŠ€å·§


**è®°å¿†æ–¹æ³•**ï¼šæŠŠå¯Œè§„åˆ™æƒ³è±¡æˆä¸€å¥å®Œæ•´çš„è¯
```
"å¯¹äºæ¥è‡ªæŸåœ°å€çš„è®¿é—®æŸæœåŠ¡çš„è¯·æ±‚ï¼Œè®°å½•æ—¥å¿—åæ‰§è¡ŒæŸåŠ¨ä½œ"

rule source address="192.168.1.10" service name="ssh" log accept
ç¿»è¯‘ï¼šå¯¹äºæ¥è‡ª192.168.1.10è®¿é—®SSHæœåŠ¡çš„è¯·æ±‚ï¼Œè®°å½•æ—¥å¿—åå…è®¸é€šè¿‡
```

---

## 3. ğŸŒ åœ°å€é…ç½®è§„åˆ™


### 3.1 æºåœ°å€é…ç½®è¯¦è§£


**åŸºæœ¬ç”¨æ³•**ï¼š
```bash
# å•ä¸ªIPåœ°å€
source address="192.168.1.100"

# ç½‘æ®µé…ç½®
source address="192.168.1.0/24"

# IPv6åœ°å€
source address="2001:db8::1"
```

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š
```bash
# å…è®¸ç‰¹å®šIPè®¿é—®SSH
firewall-cmd --add-rich-rule='rule source address="192.168.1.100" service name="ssh" accept'

# å…è®¸æ•´ä¸ªåŠå…¬ç½‘æ®µè®¿é—®
firewall-cmd --add-rich-rule='rule source address="192.168.100.0/24" service name="http" accept'
```

### 3.2 ç›®æ ‡åœ°å€é…ç½®


**åº”ç”¨åœºæ™¯**ï¼šä¸»è¦ç”¨äºæœ‰å¤šä¸ªç½‘å¡æˆ–IPçš„æœåŠ¡å™¨

```bash
# åªå…è®¸è®¿é—®ç‰¹å®šçš„æœåŠ¡å™¨IP
firewall-cmd --add-rich-rule='rule destination address="192.168.1.10" port port="8080" protocol="tcp" accept'
```

### 3.3 åœ°å€å–åæ“ä½œ


**invertå‚æ•°çš„å¨åŠ›**ï¼š

```bash
# æ‹’ç»ç‰¹å®šIPï¼Œå…è®¸å…¶ä»–æ‰€æœ‰IP
firewall-cmd --add-rich-rule='rule source address="192.168.1.100" invert="true" service name="ssh" accept'

# ç†è§£ï¼šé™¤äº†192.168.1.100è¿™ä¸ªIPï¼Œå…¶ä»–æ‰€æœ‰IPéƒ½å¯ä»¥SSHè®¿é—®
```

### 3.4 åœ°å€é…ç½®æœ€ä½³å®è·µ


**å®‰å…¨é…ç½®å»ºè®®**ï¼š
```
ğŸ”¸ SSHæœåŠ¡ï¼šåªå…è®¸ç®¡ç†ç½‘æ®µè®¿é—®
ğŸ”¸ æ•°æ®åº“ï¼šåªå…è®¸åº”ç”¨æœåŠ¡å™¨è®¿é—®
ğŸ”¸ WebæœåŠ¡ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é…ç½®
ğŸ”¸ å†…éƒ¨APIï¼šä¸¥æ ¼é™åˆ¶è®¿é—®æ¥æº
```

**é…ç½®ç¤ºä¾‹ç»„åˆ**ï¼š
```bash
# SSHåªå…è®¸ç®¡ç†ç½‘æ®µ
firewall-cmd --add-rich-rule='rule source address="10.0.0.0/8" service name="ssh" accept'

# WebæœåŠ¡å…è®¸æ‰€æœ‰è®¿é—®ï¼ˆå®é™…ä¸­è¦è°¨æ…ï¼‰
firewall-cmd --add-rich-rule='rule service name="http" accept'

# æ•°æ®åº“åªå…è®¸åº”ç”¨æœåŠ¡å™¨
firewall-cmd --add-rich-rule='rule source address="192.168.2.10" port port="3306" protocol="tcp" accept'
```

---

## 4. ğŸ”Œ ç«¯å£ä¸åè®®é…ç½®


### 4.1 ç«¯å£é…ç½®æ–¹å¼


**ä¸¤ç§é…ç½®æ–¹å¼å¯¹æ¯”**ï¼š

| **é…ç½®æ–¹å¼** | **ä½¿ç”¨åœºæ™¯** | **ç¤ºä¾‹** |
|------------|------------|----------|
| **serviceæ–¹å¼** | `å¸¸è§æ ‡å‡†æœåŠ¡` | `service name="http"` |
| **portæ–¹å¼** | `è‡ªå®šä¹‰ç«¯å£åº”ç”¨` | `port port="8080" protocol="tcp"` |

### 4.2 serviceæœåŠ¡é…ç½®


**é¢„å®šä¹‰æœåŠ¡çš„ä¼˜åŠ¿**ï¼š
- ğŸ”¸ **é…ç½®ç®€å•**ï¼šä¸ç”¨è®°ç«¯å£å·
- ğŸ”¸ **è¯­ä¹‰æ¸…æ™°**ï¼šä¸€çœ‹å°±çŸ¥é“æ˜¯ä»€ä¹ˆæœåŠ¡
- ğŸ”¸ **è‡ªåŠ¨é€‚é…**ï¼šåŒ…å«è¯¥æœåŠ¡çš„æ‰€æœ‰ç«¯å£å’Œåè®®

```bash
# å¸¸è§æœåŠ¡é…ç½®
firewall-cmd --add-rich-rule='rule source address="192.168.1.0/24" service name="http" accept'
firewall-cmd --add-rich-rule='rule source address="10.0.0.0/8" service name="ssh" accept'
firewall-cmd --add-rich-rule='rule service name="https" accept'
```

**æŸ¥çœ‹å¯ç”¨æœåŠ¡**ï¼š
```bash
firewall-cmd --get-services
# è¾“å‡ºï¼šssh http https ftp mysql postgresql ç­‰ç­‰
```

### 4.3 portç«¯å£é…ç½®


**è‡ªå®šä¹‰ç«¯å£åº”ç”¨**ï¼š
```bash
# åŸºæœ¬è¯­æ³•
port port="ç«¯å£å·" protocol="tcp|udp"

# å®é™…ç¤ºä¾‹
firewall-cmd --add-rich-rule='rule port port="8080" protocol="tcp" accept'
firewall-cmd --add-rich-rule='rule port port="9000-9010" protocol="tcp" accept'  # ç«¯å£èŒƒå›´
```

### 4.4 åè®®ç±»å‹é€‰æ‹©


**TCP vs UDP é€‰æ‹©æŒ‡å—**ï¼š

```
TCPåè®®é€‚ç”¨ï¼š
ğŸ“¡ WebæœåŠ¡ (HTTP/HTTPS)
ğŸ“¡ æ•°æ®åº“è¿æ¥ (MySQL, PostgreSQL)
ğŸ“¡ æ–‡ä»¶ä¼ è¾“ (FTP, SSH)
ğŸ“¡ é‚®ä»¶æœåŠ¡ (SMTP, IMAP)

UDPåè®®é€‚ç”¨ï¼š
ğŸ“¡ DNSæŸ¥è¯¢
ğŸ“¡ è§†é¢‘æµåª’ä½“
ğŸ“¡ æ¸¸æˆæœåŠ¡
ğŸ“¡ æ—¥å¿—ä¼ è¾“
```

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š
```bash
# Webåº”ç”¨æœåŠ¡å™¨
firewall-cmd --add-rich-rule='rule port port="8080" protocol="tcp" accept'

# DNSæœåŠ¡
firewall-cmd --add-rich-rule='rule port port="53" protocol="udp" accept'

# æ¸¸æˆæœåŠ¡å™¨
firewall-cmd --add-rich-rule='rule source address="0.0.0.0/0" port port="7777" protocol="udp" accept'
```

---

## 5. âš¡ åŠ¨ä½œç±»å‹æ·±å…¥ç†è§£


### 5.1 ä¸‰ç§åŸºæœ¬åŠ¨ä½œå¯¹æ¯”


**åŠ¨ä½œæ•ˆæœå¯¹æ¯”å›¾**ï¼š
```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ é˜²ç«å¢™è§„åˆ™åŒ¹é… â†’ æ‰§è¡ŒåŠ¨ä½œ

accept: è¯·æ±‚ âœ… â†’ æ­£å¸¸å“åº”
reject: è¯·æ±‚ âŒ â†’ è¿”å›"è¿æ¥è¢«æ‹’ç»"é”™è¯¯
drop:   è¯·æ±‚ âŒ â†’ æ²¡æœ‰ä»»ä½•å“åº”ï¼ˆåƒçŸ³æ²‰å¤§æµ·ï¼‰
```

### 5.2 accept å…è®¸åŠ¨ä½œ


**ä½¿ç”¨ç‰¹ç‚¹**ï¼š
- ğŸ”¸ **æ­£å¸¸é€šè¿‡**ï¼šè¯·æ±‚æ­£å¸¸å¤„ç†
- ğŸ”¸ **æ€§èƒ½æœ€å¥½**ï¼šä¸éœ€è¦é¢å¤–å¤„ç†
- ğŸ”¸ **ç”¨æˆ·ä½“éªŒå¥½**ï¼šä¸ä¼šæ„Ÿè§‰åˆ°é˜»æŒ¡

```bash
# å…è®¸åŠå…¬ç½‘æ®µè®¿é—®WebæœåŠ¡
firewall-cmd --add-rich-rule='rule source address="192.168.1.0/24" service name="http" accept'
```

### 5.3 reject æ‹’ç»åŠ¨ä½œ


**ä½¿ç”¨ç‰¹ç‚¹**ï¼š
- ğŸ”¸ **æ˜ç¡®æ‹’ç»**ï¼šè¿”å›é”™è¯¯ä¿¡æ¯
- ğŸ”¸ **è°ƒè¯•å‹å¥½**ï¼šèƒ½çœ‹åˆ°å…·ä½“é”™è¯¯
- ğŸ”¸ **èµ„æºæ¶ˆè€—å°**ï¼šæ¯”dropç¨å¤šä¸€ç‚¹

```bash
# æ‹’ç»å¤–ç½‘SSHè®¿é—®
firewall-cmd --add-rich-rule='rule source address="0.0.0.0/0" service name="ssh" reject'
```

**ç”¨æˆ·çœ‹åˆ°çš„æ•ˆæœ**ï¼š
```
$ ssh user@server
ssh: connect to host server port 22: Connection refused
```

### 5.4 drop ä¸¢å¼ƒåŠ¨ä½œ


**ä½¿ç”¨ç‰¹ç‚¹**ï¼š
- ğŸ”¸ **é™é»˜å¤„ç†**ï¼šä¸è¿”å›ä»»ä½•ä¿¡æ¯
- ğŸ”¸ **éšè”½æ€§å¥½**ï¼šæ”»å‡»è€…æ— æ³•ç¡®å®šç«¯å£çŠ¶æ€
- ğŸ”¸ **å¯èƒ½è¶…æ—¶**ï¼šå®¢æˆ·ç«¯ä¼šç­‰å¾…è¶…æ—¶

```bash
# ä¸¢å¼ƒå¯ç–‘IPçš„æ‰€æœ‰è¯·æ±‚
firewall-cmd --add-rich-rule='rule source address="1.2.3.4" drop'
```

**ç”¨æˆ·çœ‹åˆ°çš„æ•ˆæœ**ï¼š
```
$ telnet server 22
Trying server...
(é•¿æ—¶é—´ç­‰å¾…åè¶…æ—¶)
```

### 5.5 åŠ¨ä½œé€‰æ‹©ç­–ç•¥


**å®é™…åº”ç”¨å»ºè®®**ï¼š

```
ğŸ¯ accept: ä¿¡ä»»çš„å†…ç½‘è®¿é—®
ğŸ¯ reject: å¼€å‘æµ‹è¯•ç¯å¢ƒï¼ˆä¾¿äºè°ƒè¯•ï¼‰
ğŸ¯ drop: é˜²æ­¢æ¶æ„æ‰«æå’Œæ”»å‡»
```

**ç»„åˆåº”ç”¨ç¤ºä¾‹**ï¼š
```bash
# å†…ç½‘SSHå…è®¸
firewall-cmd --add-rich-rule='rule source address="192.168.0.0/16" service name="ssh" accept'

# å¤–ç½‘SSHä¸¢å¼ƒï¼ˆé˜²æ‰«æï¼‰
firewall-cmd --add-rich-rule='rule service name="ssh" drop'
```

---

## 6. ğŸ“Š å¯Œè§„åˆ™ä¼˜å…ˆçº§æœºåˆ¶


### 6.1 ä¼˜å…ˆçº§å¤„ç†é€»è¾‘


**è§„åˆ™åŒ¹é…æµç¨‹å›¾**ï¼š
```
æ•°æ®åŒ…åˆ°è¾¾
     â†“
å¯Œè§„åˆ™åˆ—è¡¨ï¼ˆæŒ‰æ·»åŠ é¡ºåºï¼‰
     â†“
ç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™
     â†“
æ‰§è¡Œå¯¹åº”åŠ¨ä½œ
     â†“
åœæ­¢å¤„ç†ï¼ˆä¸å†æ£€æŸ¥åç»­è§„åˆ™ï¼‰
```

### 6.2 ä¼˜å…ˆçº§å½±å“å› ç´ 


**å…³é”®ç†è§£**ï¼šå¯Œè§„åˆ™æ˜¯æŒ‰ç…§**æ·»åŠ é¡ºåº**æ¥åŒ¹é…çš„ï¼Œä¸æ˜¯æŒ‰é‡è¦æ€§æ’åºã€‚

```bash
# è§„åˆ™æ·»åŠ é¡ºåºå¾ˆé‡è¦ï¼

# é”™è¯¯é…ç½®ç¤ºä¾‹ï¼ˆé¡ºåºé—®é¢˜ï¼‰ï¼š
firewall-cmd --add-rich-rule='rule service name="ssh" drop'        # å…ˆæ·»åŠ ï¼šä¸¢å¼ƒæ‰€æœ‰SSH
firewall-cmd --add-rich-rule='rule source address="192.168.1.0/24" service name="ssh" accept'  # åæ·»åŠ ï¼šå…è®¸å†…ç½‘SSH

# ç»“æœï¼šå†…ç½‘ä¹Ÿæ— æ³•SSHï¼Œå› ä¸ºç¬¬ä¸€æ¡è§„åˆ™å°±æŠŠæ‰€æœ‰SSHè¯·æ±‚ä¸¢å¼ƒäº†

# æ­£ç¡®é…ç½®ç¤ºä¾‹ï¼š
firewall-cmd --add-rich-rule='rule source address="192.168.1.0/24" service name="ssh" accept'  # å…ˆæ·»åŠ ï¼šå…è®¸å†…ç½‘SSH
firewall-cmd --add-rich-rule='rule service name="ssh" drop'        # åæ·»åŠ ï¼šä¸¢å¼ƒå…¶ä»–SSH
```

### 6.3 æŸ¥çœ‹è§„åˆ™é¡ºåº


```bash
# æŸ¥çœ‹å½“å‰æ‰€æœ‰å¯Œè§„åˆ™
firewall-cmd --list-rich-rules

# è¾“å‡ºç¤ºä¾‹ï¼š
rule source address="192.168.1.0/24" service name="ssh" accept
rule service name="ssh" drop
rule source address="10.0.0.100" port port="8080" protocol="tcp" accept
```

### 6.4 è§„åˆ™é‡æ–°æ’åº


**åˆ é™¤é‡æ–°æ·»åŠ æ³•**ï¼š
```bash
# 1. å…ˆè®°å½•æ‰€æœ‰è§„åˆ™
firewall-cmd --list-rich-rules > rules_backup.txt

# 2. åˆ é™¤æ‰€æœ‰å¯Œè§„åˆ™
firewall-cmd --remove-rich-rule='å…·ä½“è§„åˆ™å†…å®¹'

# 3. æŒ‰æ­£ç¡®é¡ºåºé‡æ–°æ·»åŠ 
firewall-cmd --add-rich-rule='...'
```

### 6.5 ä¼˜å…ˆçº§æœ€ä½³å®è·µ


**è§„åˆ™æ’åºåŸåˆ™**ï¼š
```
1. ğŸ¯ ç‰¹æ®Šä¾‹å¤–è§„åˆ™æ”¾å‰é¢ï¼ˆå…è®¸ç‰¹å®šIP/æœåŠ¡ï¼‰
2. ğŸ¯ ä¸€èˆ¬é™åˆ¶è§„åˆ™æ”¾ä¸­é—´
3. ğŸ¯ é»˜è®¤æ‹’ç»è§„åˆ™æ”¾æœ€å
```

**å®é™…é…ç½®æ¨¡æ¿**ï¼š
```bash
# 1. VIPç”¨æˆ·ç‰¹æƒè®¿é—®
firewall-cmd --add-rich-rule='rule source address="1.2.3.4" accept'

# 2. å†…ç½‘æ­£å¸¸è®¿é—®
firewall-cmd --add-rich-rule='rule source address="192.168.0.0/16" service name="ssh" accept'
firewall-cmd --add-rich-rule='rule source address="10.0.0.0/8" service name="http" accept'

# 3. å¤–ç½‘é™åˆ¶è®¿é—®
firewall-cmd --add-rich-rule='rule service name="ssh" drop'
```

---

## 7. ğŸ”§ å¤æ‚è§„åˆ™ç»„åˆå®æˆ˜


### 7.1 å¤šæ¡ä»¶ç»„åˆè§„åˆ™


**å¤æ‚åœºæ™¯éœ€æ±‚**ï¼š
```
ä¼ä¸šè¦æ±‚ï¼š
- åŠå…¬æ—¶é—´ï¼ˆ9:00-18:00ï¼‰å…è®¸å‘˜å·¥è®¿é—®å¼€å‘æœåŠ¡å™¨
- éåŠå…¬æ—¶é—´åªå…è®¸è¿ç»´äººå‘˜è®¿é—®
- æ‰€æœ‰è®¿é—®éƒ½è¦è®°å½•æ—¥å¿—
- å¯ç–‘IPç›´æ¥å°ç¦
```

**å¯¹åº”é…ç½®æ–¹æ¡ˆ**ï¼š
```bash
# 1. å¯ç–‘IPç›´æ¥å°ç¦ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
firewall-cmd --add-rich-rule='rule source address="æ¶æ„IP" log prefix="BLOCKED: " drop'

# 2. è¿ç»´äººå‘˜å…¨å¤©å€™è®¿é—®
firewall-cmd --add-rich-rule='rule source address="è¿ç»´ç½‘æ®µ" service name="ssh" log prefix="ADMIN: " accept'

# 3. å¼€å‘äººå‘˜é™åˆ¶è®¿é—®ï¼ˆéœ€è¦é…åˆå®šæ—¶ä»»åŠ¡å®ç°æ—¶é—´æ§åˆ¶ï¼‰
firewall-cmd --add-rich-rule='rule source address="å¼€å‘ç½‘æ®µ" service name="ssh" log prefix="DEV: " accept'

# 4. å…¶ä»–è®¿é—®è®°å½•åæ‹’ç»
firewall-cmd --add-rich-rule='rule service name="ssh" log prefix="DENIED: " reject'
```

### 7.2 æœåŠ¡ç«¯å£ç»„åˆé…ç½®


**Webåº”ç”¨å®Œæ•´é˜²æŠ¤**ï¼š
```bash
# WebæœåŠ¡å™¨å®‰å…¨é…ç½®ç»„åˆ

# 1. å…è®¸æ‰€æœ‰äººè®¿é—®WebæœåŠ¡
firewall-cmd --add-rich-rule='rule service name="http" accept'
firewall-cmd --add-rich-rule='rule service name="https" accept'

# 2. ç®¡ç†åå°åªå…è®¸ç®¡ç†ç½‘æ®µ
firewall-cmd --add-rich-rule='rule source address="192.168.100.0/24" port port="8080" protocol="tcp" accept'
firewall-cmd --add-rich-rule='rule port port="8080" protocol="tcp" log prefix="ADMIN_BLOCKED: " drop'

# 3. æ•°æ®åº“åªå…è®¸åº”ç”¨æœåŠ¡å™¨è®¿é—®
firewall-cmd --add-rich-rule='rule source address="192.168.1.10" port port="3306" protocol="tcp" accept'
firewall-cmd --add-rich-rule='rule port port="3306" protocol="tcp" drop'

# 4. SSHåªå…è®¸è·³æ¿æœºè®¿é—®
firewall-cmd --add-rich-rule='rule source address="è·³æ¿æœºIP" service name="ssh" log prefix="SSH: " accept'
firewall-cmd --add-rich-rule='rule service name="ssh" log prefix="SSH_ATTACK: " drop'
```

### 7.3 æ—¥å¿—è®°å½•ä¸é™é€Ÿ


**æ—¥å¿—é…ç½®è¯¦è§£**ï¼š
```bash
# åŸºæœ¬æ—¥å¿—è®°å½•
log prefix="è‡ªå®šä¹‰æ ‡è¯†: "

# æ—¥å¿—çº§åˆ«æ§åˆ¶
log level="info|warning|error"

# æ—¥å¿—é™é€Ÿï¼ˆé˜²æ­¢æ—¥å¿—æ´ªæ°´ï¼‰
log limit value="10/m"    # æ¯åˆ†é’Ÿæœ€å¤š10æ¡
log limit value="1/s"     # æ¯ç§’æœ€å¤š1æ¡
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```bash
# è®°å½•æ‰€æœ‰SSHå°è¯•ï¼Œä½†é™åˆ¶æ—¥å¿—é‡
firewall-cmd --add-rich-rule='rule service name="ssh" log prefix="SSH_ATTEMPT: " level="info" limit value="5/m" accept'

# è®°å½•è¢«é˜»æ­¢çš„è®¿é—®
firewall-cmd --add-rich-rule='rule source address="0.0.0.0/0" port port="3389" protocol="tcp" log prefix="RDP_BLOCKED: " level="warning" drop'
```

### 7.4 åŠ¨æ€è§„åˆ™ç®¡ç†


**ä¸´æ—¶è§„åˆ™åº”ç”¨**ï¼š
```bash
# ä¸´æ—¶å…è®¸ç‰¹å®šIPè®¿é—®ï¼ˆé‡å¯åå¤±æ•ˆï¼‰
firewall-cmd --add-rich-rule='rule source address="ä¸´æ—¶IP" service name="ssh" accept'

# æ°¸ä¹…ä¿å­˜è§„åˆ™
firewall-cmd --add-rich-rule='rule source address="å›ºå®šIP" service name="ssh" accept' --permanent
firewall-cmd --reload
```

**è§„åˆ™æ‰¹é‡ç®¡ç†**ï¼š
```bash
# å¯¼å‡ºå½“å‰è§„åˆ™
firewall-cmd --list-rich-rules > current_rules.txt

# æ‰¹é‡åˆ é™¤è§„åˆ™
while IFS= read -r rule; do
    firewall-cmd --remove-rich-rule="$rule"
done < current_rules.txt

# æ‰¹é‡æ·»åŠ è§„åˆ™
while IFS= read -r rule; do
    firewall-cmd --add-rich-rule="$rule"
done < new_rules.txt
```

### 7.5 æ•…éšœæ’é™¤ä¸è°ƒè¯•


**å¸¸è§é—®é¢˜è¯Šæ–­**ï¼š

```bash
# 1. æ£€æŸ¥è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ
firewall-cmd --list-rich-rules

# 2. æŸ¥çœ‹è§„åˆ™åŒ¹é…æƒ…å†µï¼ˆé€šè¿‡æ—¥å¿—ï¼‰
tail -f /var/log/messages | grep "è‡ªå®šä¹‰å‰ç¼€"

# 3. æµ‹è¯•ç‰¹å®šç«¯å£è®¿é—®
nmap -p ç«¯å£ ç›®æ ‡IP
telnet ç›®æ ‡IP ç«¯å£

# 4. ä¸´æ—¶å…³é—­é˜²ç«å¢™æµ‹è¯•
systemctl stop firewalld
# æµ‹è¯•å®Œæ¯•åè®°å¾—é‡æ–°å¯åŠ¨
systemctl start firewalld
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¯Œè§„åˆ™æœ¬è´¨ï¼šfirewalldçš„ç²¾ç»†åŒ–è®¿é—®æ§åˆ¶å·¥å…·
ğŸ”¸ è¯­æ³•ç»“æ„ï¼šsource + service/port + log + actionçš„ç»„åˆ
ğŸ”¸ ä¼˜å…ˆçº§åŸç†ï¼šæŒ‰æ·»åŠ é¡ºåºåŒ¹é…ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™ç”Ÿæ•ˆ
ğŸ”¸ ä¸‰ç§åŠ¨ä½œï¼šacceptå…è®¸ã€rejectæ‹’ç»ã€dropä¸¢å¼ƒçš„åŒºåˆ«
ğŸ”¸ åœ°å€é…ç½®ï¼šæ”¯æŒå•IPã€ç½‘æ®µã€IPv6å’Œå–åæ“ä½œ
ğŸ”¸ æœåŠ¡vsç«¯å£ï¼šé¢„å®šä¹‰æœåŠ¡ vs è‡ªå®šä¹‰ç«¯å£çš„é€‰æ‹©
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¯Œè§„åˆ™çš„è®¾è®¡æ€æƒ³**
```
ä¼ ç»Ÿé˜²ç«å¢™ï¼šç®€å•çš„å…è®¸/æ‹’ç»
å¯Œè§„åˆ™é˜²ç«å¢™ï¼šè°åœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹è®¿é—®ä»€ä¹ˆæœåŠ¡æ‰§è¡Œä»€ä¹ˆåŠ¨ä½œ

è¿™ç§è®¾è®¡è®©å®‰å…¨ç­–ç•¥æ›´åŠ çµæ´»å’Œç²¾ç¡®
```

**ğŸ”¹ ä¼˜å…ˆçº§çš„é‡è¦æ€§**
```
è§„åˆ™é¡ºåºç›´æ¥å½±å“å®‰å…¨æ•ˆæœ
é”™è¯¯çš„é¡ºåºå¯èƒ½å¯¼è‡´ï¼š
- å®‰å…¨ç­–ç•¥å¤±æ•ˆ
- åˆæ³•è®¿é—®è¢«é˜»æ­¢  
- æ¶æ„è®¿é—®è¢«å…è®¸
```

**ğŸ”¹ åŠ¨ä½œé€‰æ‹©çš„ç­–ç•¥æ„ä¹‰**
```
accept: ä¿¡ä»»ç¯å¢ƒï¼Œæ­£å¸¸ä¸šåŠ¡
reject: æµ‹è¯•ç¯å¢ƒï¼Œä¾¿äºè°ƒè¯•
drop: ç”Ÿäº§ç¯å¢ƒï¼Œé˜²æ­¢æ”»å‡»æ¢æµ‹
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é…ç½®åŸåˆ™**ï¼š
```
1. ğŸ¯ å…ˆè§„åˆ’åé…ç½®ï¼šæ˜ç¡®å®‰å…¨éœ€æ±‚å’Œè®¿é—®ç­–ç•¥
2. ğŸ¯ æœ€å°æƒé™åŸåˆ™ï¼šåªå¼€æ”¾å¿…è¦çš„è®¿é—®
3. ğŸ¯ åˆ†å±‚é˜²æŠ¤ï¼šç»“åˆå…¶ä»–å®‰å…¨æªæ–½
4. ğŸ¯ æ—¥å¿—è®°å½•ï¼šé‡è¦è®¿é—®è¦æœ‰å®¡è®¡ç—•è¿¹
5. ğŸ¯ å®šæœŸå›é¡¾ï¼šæ¸…ç†æ— ç”¨è§„åˆ™ï¼Œä¼˜åŒ–æ€§èƒ½
```

**å¸¸è§åº”ç”¨åœºæ™¯**ï¼š
- **WebæœåŠ¡å™¨**ï¼šå…¬ç½‘è®¿é—®Webï¼Œå†…ç½‘è®¿é—®ç®¡ç†
- **æ•°æ®åº“æœåŠ¡å™¨**ï¼šåªå…è®¸åº”ç”¨æœåŠ¡å™¨è¿æ¥
- **è·³æ¿æœº**ï¼šSSHè®¿é—®çš„å”¯ä¸€å…¥å£
- **å¼€å‘ç¯å¢ƒ**ï¼šçµæ´»çš„æµ‹è¯•è®¿é—®æ§åˆ¶

### 8.4 å­¦ä¹ å»ºè®®


**æŒæ¡æ­¥éª¤**ï¼š
```
1. ç†è§£åŸºæœ¬è¯­æ³•å’Œæ¦‚å¿µ
2. ç»ƒä¹ å•æ¡ä»¶è§„åˆ™é…ç½®
3. æŒæ¡å¤šæ¡ä»¶ç»„åˆè§„åˆ™
4. å­¦ä¼šæ•…éšœè¯Šæ–­å’Œä¼˜åŒ–
5. ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨
```

**é¿å…å¸¸è§é”™è¯¯**ï¼š
- âŒ å¿½ç•¥è§„åˆ™é¡ºåºå¯¼è‡´ç­–ç•¥å¤±æ•ˆ
- âŒ è¿‡åº¦å¤æ‚çš„è§„åˆ™éš¾ä»¥ç»´æŠ¤
- âŒ ç¼ºä¹æµ‹è¯•å¯¼è‡´ä¸šåŠ¡ä¸­æ–­
- âŒ ä¸è®°å½•æ—¥å¿—æ— æ³•å®¡è®¡å’Œæ’éšœ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¯Œè§„åˆ™é…ç½®æœ‰é—¨é“ï¼Œè¯­æ³•ç»“æ„è¦è®°ç‰¢
æºåœ°å€æœåŠ¡åŠ åŠ¨ä½œï¼Œä¼˜å…ˆçº§åˆ«ä¸èƒ½å°‘
acceptå…è®¸rejectæ‹’ï¼Œdropä¸¢å¼ƒæœ€éšè”½
è§„åˆ™é¡ºåºå¾ˆå…³é”®ï¼Œå…ˆç‰¹æ®Šåä¸€èˆ¬
```