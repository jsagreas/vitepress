---
title: 17ã€æ¥å£çº§åˆ«å®‰å…¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [æ¥å£å®‰å…¨çº§åˆ«åŸºç¡€æ¦‚å¿µ](#1-æ¥å£å®‰å…¨çº§åˆ«åŸºç¡€æ¦‚å¿µ)
2. [ä¸åŒæ¥å£çš„å·®å¼‚åŒ–é…ç½®](#2-ä¸åŒæ¥å£çš„å·®å¼‚åŒ–é…ç½®)
3. [å†…ç½‘å¤–ç½‘æ¥å£åŒºåˆ†ç®¡ç†](#3-å†…ç½‘å¤–ç½‘æ¥å£åŒºåˆ†ç®¡ç†)
4. [æ¥å£æµé‡æ§åˆ¶æœºåˆ¶](#4-æ¥å£æµé‡æ§åˆ¶æœºåˆ¶)
5. [æ¥å£çº§è§„åˆ™ä¼˜å…ˆçº§](#5-æ¥å£çº§è§„åˆ™ä¼˜å…ˆçº§)
6. [å¤šç½‘å¡ç¯å¢ƒé…ç½®å®æˆ˜](#6-å¤šç½‘å¡ç¯å¢ƒé…ç½®å®æˆ˜)
7. [è™šæ‹Ÿæ¥å£å¤„ç†æ–¹æ¡ˆ](#7-è™šæ‹Ÿæ¥å£å¤„ç†æ–¹æ¡ˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ æ¥å£å®‰å…¨çº§åˆ«åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ¥å£å®‰å…¨çº§åˆ«


**æ ¸å¿ƒç†è§£**ï¼šæ¥å£å®‰å…¨çº§åˆ«å°±æ˜¯ç»™ä¸åŒçš„ç½‘ç»œæ¥å£ï¼ˆç½‘å¡ï¼‰è®¾ç½®ä¸åŒçš„å®‰å…¨ç­–ç•¥

```
ç®€å•æ¯”å–»ï¼š
ä½ å®¶æœ‰å‰é—¨å’Œåé—¨
- å‰é—¨é¢å‘å¤§è¡—ï¼ˆå¤–ç½‘æ¥å£ï¼‰â†’ å®‰å…¨çº§åˆ«é«˜ï¼Œä¸¥æ ¼æ£€æŸ¥
- åé—¨é¢å‘è‡ªå®¶é™¢å­ï¼ˆå†…ç½‘æ¥å£ï¼‰â†’ å®‰å…¨çº§åˆ«ä½ï¼Œç›¸å¯¹å®½æ¾

ç½‘ç»œæ¥å£ä¹Ÿæ˜¯åŒæ ·é“ç†ï¼š
- eth0 è¿æ¥äº’è”ç½‘ â†’ é«˜å®‰å…¨çº§åˆ«
- eth1 è¿æ¥å†…ç½‘ â†’ ä½å®‰å…¨çº§åˆ«  
- lo æœ¬åœ°å›ç¯ â†’ æœ€å®½æ¾çº§åˆ«
```

### 1.2 Zone å®‰å…¨åŸŸçš„ä½œç”¨


**Zoneï¼ˆå®‰å…¨åŸŸï¼‰**ï¼šFirewalld ä¸­é¢„å®šä¹‰çš„å®‰å…¨çº§åˆ«æ¨¡æ¿

```
å¸¸ç”¨å®‰å…¨åŸŸä»ä¸¥åˆ°æ¾ï¼š
drop    â†’ ä¸¢å¼ƒæ‰€æœ‰è¿æ¥ï¼ˆæœ€ä¸¥æ ¼ï¼‰
block   â†’ æ‹’ç»æ‰€æœ‰è¿æ¥ï¼Œè¿”å›ç¦æ­¢æ¶ˆæ¯  
public  â†’ å…¬å…±ç½‘ç»œï¼Œåªå…è®¸é€‰ä¸­çš„æœåŠ¡
external â†’ å¤–éƒ¨ç½‘ç»œï¼Œå¯ç”¨ NAT åœ°å€ä¼ªè£…
dmz     â†’ éå†›äº‹åŒ–åŒºåŸŸï¼Œæœ‰é™æœåŠ¡
work    â†’ å·¥ä½œç½‘ç»œï¼Œä¿¡ä»»åº¦è¾ƒé«˜
home    â†’ å®¶åº­ç½‘ç»œï¼Œæ›´å¤šæœåŠ¡å¯ç”¨
internal â†’ å†…éƒ¨ç½‘ç»œï¼Œé«˜ä¿¡ä»»åº¦
trusted â†’ å®Œå…¨ä¿¡ä»»ï¼ˆæœ€å®½æ¾ï¼‰
```

**å®é™…åœºæ™¯å¯¹åº”**ï¼š
- **è·¯ç”±å™¨ WANå£** â†’ `external` åŸŸï¼ˆé¢å‘äº’è”ç½‘ï¼‰
- **åŠå…¬å®¤ç½‘å¡** â†’ `work` åŸŸï¼ˆå·¥ä½œç¯å¢ƒï¼‰
- **å®¶ç”¨ WiFi** â†’ `home` åŸŸï¼ˆå®¶åº­ç¯å¢ƒï¼‰
- **æœåŠ¡å™¨å†…ç½‘å¡** â†’ `internal` åŸŸï¼ˆå†…éƒ¨é€šä¿¡ï¼‰

### 1.3 æ¥å£ä¸ Zone çš„ç»‘å®šå…³ç³»


```
ä¸€ä¸ªæ¥å£åªèƒ½å±äºä¸€ä¸ª Zone
ä¸€ä¸ª Zone å¯ä»¥åŒ…å«å¤šä¸ªæ¥å£

ç»‘å®šå…³ç³»ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ¥å£     â”‚       Zone          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ eth0        â”‚ externalï¼ˆå¤–ç½‘ï¼‰     â”‚
â”‚ eth1        â”‚ internalï¼ˆå†…ç½‘ï¼‰     â”‚
â”‚ wlan0       â”‚ homeï¼ˆæ— çº¿ï¼‰        â”‚
â”‚ lo          â”‚ trustedï¼ˆæœ¬åœ°ï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”§ ä¸åŒæ¥å£çš„å·®å¼‚åŒ–é…ç½®


### 2.1 æŸ¥çœ‹å½“å‰æ¥å£é…ç½®


**æŸ¥çœ‹æ‰€æœ‰æ¥å£çš„ Zone åˆ†é…**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰æ´»åŠ¨çš„æ¥å£å’Œå¯¹åº” Zone
firewall-cmd --get-active-zones

# æŸ¥çœ‹ç‰¹å®šæ¥å£å±äºå“ªä¸ª Zone
firewall-cmd --get-zone-of-interface=eth0

# æŸ¥çœ‹æŸä¸ª Zone åŒ…å«å“ªäº›æ¥å£
firewall-cmd --zone=public --list-interfaces
```

**è¾“å‡ºç¤ºä¾‹è§£è¯»**ï¼š
```bash
$ firewall-cmd --get-active-zones
external
  interfaces: eth0
internal  
  interfaces: eth1 eth2
trusted
  interfaces: lo
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> è¿™é‡Œæ˜¾ç¤ºäº†ä¸‰ä¸ªæ´»åŠ¨çš„å®‰å…¨åŸŸï¼š`external` åŸŸç®¡ç† eth0 æ¥å£ï¼Œ`internal` åŸŸç®¡ç† eth1 å’Œ eth2 æ¥å£ï¼Œ`trusted` åŸŸç®¡ç†æœ¬åœ°å›ç¯æ¥å£

### 2.2 ä¸ºä¸åŒæ¥å£è®¾ç½®ä¸åŒå®‰å…¨çº§åˆ«


**åŸºæœ¬è®¾ç½®å‘½ä»¤**ï¼š
```bash
# å°†æ¥å£ç»‘å®šåˆ°æŒ‡å®š Zoneï¼ˆä¸´æ—¶ï¼‰
firewall-cmd --zone=external --change-interface=eth0

# å°†æ¥å£ç»‘å®šåˆ°æŒ‡å®š Zoneï¼ˆæ°¸ä¹…ï¼‰
firewall-cmd --permanent --zone=external --change-interface=eth0
firewall-cmd --reload

# ç§»é™¤æ¥å£ä» Zone
firewall-cmd --zone=external --remove-interface=eth0
```

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š
```bash
# å¤–ç½‘æ¥å£ï¼šä¸¥æ ¼æ§åˆ¶
firewall-cmd --permanent --zone=external --change-interface=eth0
firewall-cmd --permanent --zone=external --set-target=default

# å†…ç½‘æ¥å£ï¼šç›¸å¯¹å®½æ¾  
firewall-cmd --permanent --zone=internal --change-interface=eth1
firewall-cmd --permanent --zone=internal --set-target=ACCEPT

# ç®¡ç†æ¥å£ï¼šé«˜åº¦ä¿¡ä»»
firewall-cmd --permanent --zone=trusted --change-interface=eth2

# åº”ç”¨é…ç½®
firewall-cmd --reload
```

### 2.3 å·®å¼‚åŒ–æœåŠ¡å¼€æ”¾ç­–ç•¥


**å¤–ç½‘æ¥å£ï¼ˆeth0ï¼‰- æœ€å°åŒ–åŸåˆ™**ï¼š
```bash
# åªå¼€æ”¾å¿…éœ€çš„æœåŠ¡
firewall-cmd --permanent --zone=external --add-service=ssh
firewall-cmd --permanent --zone=external --add-service=http
firewall-cmd --permanent --zone=external --add-service=https

# ä¸¥æ ¼çš„ç«¯å£æ§åˆ¶
firewall-cmd --permanent --zone=external --add-port=22/tcp
firewall-cmd --permanent --zone=external --remove-port=8080/tcp
```

**å†…ç½‘æ¥å£ï¼ˆeth1ï¼‰- ä¾¿æ°‘åŸåˆ™**ï¼š
```bash
# å¼€æ”¾æ›´å¤šå†…ç½‘æœåŠ¡
firewall-cmd --permanent --zone=internal --add-service=ssh
firewall-cmd --permanent --zone=internal --add-service=samba
firewall-cmd --permanent --zone=internal --add-service=nfs
firewall-cmd --permanent --zone=internal --add-service=mysql

# å…è®¸å†…ç½‘å¸¸ç”¨ç«¯å£æ®µ
firewall-cmd --permanent --zone=internal --add-port=8000-9000/tcp
```

---

## 3. ğŸ  å†…ç½‘å¤–ç½‘æ¥å£åŒºåˆ†ç®¡ç†


### 3.1 ç½‘ç»œæ‹“æ‰‘è¯†åˆ«


**å…¸å‹çš„æœåŠ¡å™¨ç½‘ç»œç¯å¢ƒ**ï¼š
```
                 äº’è”ç½‘
                    |
              [è·¯ç”±å™¨/é˜²ç«å¢™]
                    |
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
            â”‚               â”‚
         å¤–ç½‘æ®µ          å†…ç½‘æ®µ
     (192.168.1.x)   (10.0.0.x)
            â”‚               â”‚
        â”Œâ”€â”€â”€â”´â”€â”€â”€â”       â”Œâ”€â”€â”€â”´â”€â”€â”€â”
        â”‚ eth0  â”‚       â”‚ eth1  â”‚
        â”‚å¤–ç½‘æ¥å£â”‚       â”‚å†…ç½‘æ¥å£â”‚
        â””â”€â”€â”€â”¬â”€â”€â”€â”˜       â””â”€â”€â”€â”¬â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 æœåŠ¡å™¨
```

### 3.2 æ¥å£è¯†åˆ«å’Œåˆ†ç±»


**é€šè¿‡ IP åœ°å€æ®µè¯†åˆ«æ¥å£æ€§è´¨**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£
ip addr show

# åˆ†æè¾“å‡ºç¤ºä¾‹ï¼š
# eth0: inet 203.0.113.10/24  â†’ å…¬ç½‘ IPï¼Œå¤–ç½‘æ¥å£
# eth1: inet 192.168.1.100/24 â†’ ç§æœ‰ IPï¼Œå†…ç½‘æ¥å£  
# eth2: inet 10.0.0.50/24     â†’ ç§æœ‰ IPï¼Œç®¡ç†ç½‘æ¥å£
```

**è‡ªåŠ¨åŒ–è¯†åˆ«è„šæœ¬æ€è·¯**ï¼š
```bash
#!/bin/bash
# æ ¹æ® IP åœ°å€è‡ªåŠ¨åˆ†ç±»æ¥å£

for interface in $(ls /sys/class/net/ | grep -E '^eth|^ens|^enp'); do
    ip=$(ip addr show $interface | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | head -1)
    
    if [[ $ip =~ ^10\.|^172\.(1[6-9]|2[0-9]|3[0-1])\.|^192\.168\. ]]; then
        echo "$interface ($ip) - å†…ç½‘æ¥å£ â†’ internal zone"
    else
        echo "$interface ($ip) - å¤–ç½‘æ¥å£ â†’ external zone"  
    fi
done
```

### 3.3 å†…å¤–ç½‘è®¿é—®ç­–ç•¥å·®å¼‚


| æ¥å£ç±»å‹ | **å®‰å…¨ç­–ç•¥** | **å¼€æ”¾æœåŠ¡** | **è®¿é—®æ§åˆ¶** | **æ—¥å¿—è®°å½•** |
|---------|------------|-------------|-------------|-------------|
| ğŸŒ **å¤–ç½‘æ¥å£** | `æä¸¥æ ¼` | SSH, HTTP, HTTPS | IPç™½åå• + ç«¯å£æœ€å°åŒ– | è¯¦ç»†æ—¥å¿— |
| ğŸ  **å†…ç½‘æ¥å£** | `ç›¸å¯¹å®½æ¾` | å†…ç½‘æœåŠ¡å…¨å¼€ | ç½‘æ®µé™åˆ¶ | ç®€è¦æ—¥å¿— |  
| ğŸ”§ **ç®¡ç†æ¥å£** | `é«˜åº¦ä¿¡ä»»` | ç®¡ç†æœåŠ¡ | ç®¡ç†å‘˜ä¸“ç”¨ | å®¡è®¡æ—¥å¿— |

**å¤–ç½‘æ¥å£ä¸¥æ ¼ç­–ç•¥**ï¼š
```bash
# é»˜è®¤æ‹’ç»ç­–ç•¥
firewall-cmd --permanent --zone=external --set-target=default

# åªå…è®¸ç‰¹å®š IP è®¿é—® SSH
firewall-cmd --permanent --zone=external --add-rich-rule='
rule family="ipv4" source address="203.0.113.100" service name="ssh" accept'

# é™åˆ¶è¿æ¥é¢‘ç‡ï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰
firewall-cmd --permanent --zone=external --add-rich-rule='
rule family="ipv4" service name="ssh" limit value="3/m" accept'
```

**å†…ç½‘æ¥å£å®½æ¾ç­–ç•¥**ï¼š
```bash
# ä¿¡ä»»å†…ç½‘æ®µ
firewall-cmd --permanent --zone=internal --add-source=192.168.1.0/24
firewall-cmd --permanent --zone=internal --add-source=10.0.0.0/24

# å…è®¸å†…ç½‘æœåŠ¡
firewall-cmd --permanent --zone=internal --add-service=samba
firewall-cmd --permanent --zone=internal --add-service=nfs
firewall-cmd --permanent --zone=internal --add-service=mysql
```

---

## 4. ğŸš¦ æ¥å£æµé‡æ§åˆ¶æœºåˆ¶


### 4.1 æµé‡æ§åˆ¶åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ¥å£æµé‡æ§åˆ¶**ï¼š
å¯¹é€šè¿‡ç‰¹å®šç½‘ç»œæ¥å£çš„æ•°æ®åŒ…è¿›è¡Œé™åˆ¶ã€è¿‡æ»¤å’Œç®¡ç†

```
æµé‡æ§åˆ¶çš„ä¸‰ä¸ªå±‚é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ•°æ®åŒ…è¿‡æ»¤ - å…è®¸/æ‹’ç»ç‰¹å®šæµé‡    â”‚
â”‚ 2. è¿æ¥é™åˆ¶ - æ§åˆ¶å¹¶å‘è¿æ¥æ•°é‡      â”‚  
â”‚ 3. å¸¦å®½ç®¡ç† - é™åˆ¶æµé‡é€Ÿåº¦         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åŸºäºæ¥å£çš„åŒ…è¿‡æ»¤


**æŒ‰æ¥å£æ–¹å‘æ§åˆ¶æµé‡**ï¼š
```bash
# æ§åˆ¶ä»å¤–ç½‘æ¥å£è¿›å…¥çš„æµé‡
firewall-cmd --permanent --zone=external --add-rich-rule='
rule family="ipv4" source address="0.0.0.0/0" 
port protocol="tcp" port="80" accept'

# åªå…è®¸å†…ç½‘æ¥å£è®¿é—®æ•°æ®åº“
firewall-cmd --permanent --zone=internal --add-rich-rule='
rule family="ipv4" source address="192.168.1.0/24" 
port protocol="tcp" port="3306" accept'

# é˜»æ­¢å¤–ç½‘æ¥å£è®¿é—®å†…ç½‘æœåŠ¡
firewall-cmd --permanent --zone=external --add-rich-rule='
rule family="ipv4" port protocol="tcp" port="3306" drop'
```

### 4.3 è¿æ¥æ•°é‡é™åˆ¶


**é˜²æ­¢å•ä¸€æ¥å£è¿‡è½½**ï¼š
```bash
# é™åˆ¶å¤–ç½‘æ¥å£çš„ SSH è¿æ¥é¢‘ç‡
firewall-cmd --permanent --zone=external --add-rich-rule='
rule family="ipv4" service name="ssh" 
limit value="5/m" burst="10" accept'

# é™åˆ¶ HTTP è¿æ¥æ•°ï¼ˆéœ€è¦é…åˆå…¶ä»–å·¥å…·ï¼‰
firewall-cmd --permanent --zone=external --add-rich-rule='
rule family="ipv4" service name="http" 
limit value="100/s" accept'
```

> âš ï¸ **é‡è¦è¯´æ˜**  
> Firewalld çš„è¿æ¥é™åˆ¶åŠŸèƒ½ç›¸å¯¹åŸºç¡€ï¼Œå¤æ‚çš„æµé‡æ§åˆ¶å»ºè®®é…åˆ `tc`ï¼ˆTraffic Controlï¼‰æˆ– `nginx` ç­‰å·¥å…·å®ç°

### 4.4 æ¥å£çº§åˆ«çš„æœåŠ¡éš”ç¦»


**ä¸åŒæ¥å£å¼€æ”¾ä¸åŒæœåŠ¡ç»„åˆ**ï¼š
```bash
# Web æœåŠ¡å™¨åœºæ™¯é…ç½®
# å¤–ç½‘æ¥å£ï¼šåªå¼€æ”¾ Web æœåŠ¡
firewall-cmd --permanent --zone=external --add-service=http
firewall-cmd --permanent --zone=external --add-service=https

# å†…ç½‘æ¥å£ï¼šå¼€æ”¾ç®¡ç†å’Œæ•°æ®åº“æœåŠ¡
firewall-cmd --permanent --zone=internal --add-service=ssh
firewall-cmd --permanent --zone=internal --add-service=mysql
firewall-cmd --permanent --zone=internal --add-service=redis

# ç®¡ç†æ¥å£ï¼šå¼€æ”¾ç›‘æ§æœåŠ¡
firewall-cmd --permanent --zone=trusted --add-port=9090/tcp  # Prometheus
firewall-cmd --permanent --zone=trusted --add-port=3000/tcp  # Grafana
```

---

## 5. âš¡ æ¥å£çº§è§„åˆ™ä¼˜å…ˆçº§


### 5.1 ä¼˜å…ˆçº§å¤„ç†æœºåˆ¶


**Firewalld è§„åˆ™å¤„ç†é¡ºåº**ï¼š
```
1. ç›´æ¥è§„åˆ™ï¼ˆDirect Rulesï¼‰         â† æœ€é«˜ä¼˜å…ˆçº§
2. å¯Œè§„åˆ™ï¼ˆRich Rulesï¼‰            â† ç¬¬äºŒä¼˜å…ˆçº§  
3. æœåŠ¡è§„åˆ™ï¼ˆService Rulesï¼‰        â† ç¬¬ä¸‰ä¼˜å…ˆçº§
4. ç«¯å£è§„åˆ™ï¼ˆPort Rulesï¼‰          â† ç¬¬å››ä¼˜å…ˆçº§
5. Zone é»˜è®¤è§„åˆ™                   â† æœ€ä½ä¼˜å…ˆçº§
```

**å®é™…å¤„ç†æµç¨‹**ï¼š
```
æ•°æ®åŒ…åˆ°è¾¾ â†’ æ£€æŸ¥ç›´æ¥è§„åˆ™ â†’ æ£€æŸ¥å¯Œè§„åˆ™ â†’ æ£€æŸ¥æœåŠ¡è§„åˆ™ 
     â†“
  åŒ¹é…æˆåŠŸ â†’ æ‰§è¡ŒåŠ¨ä½œï¼ˆACCEPT/DROP/REJECTï¼‰
     â†“  
  æ— åŒ¹é… â†’ ç»§ç»­ä¸‹ä¸€çº§åˆ«è§„åˆ™æ£€æŸ¥
     â†“
  éƒ½æ— åŒ¹é… â†’ æ‰§è¡Œ Zone é»˜è®¤åŠ¨ä½œ
```

### 5.2 åŒä¸€æ¥å£å¤šæ¡è§„åˆ™çš„å¤„ç†


**å¯Œè§„åˆ™çš„ä¼˜å…ˆçº§ç¤ºä¾‹**ï¼š
```bash
# è§„åˆ™1ï¼šæ‹’ç»æ‰€æœ‰æ¥è‡ª 192.168.1.100 çš„è®¿é—®
firewall-cmd --permanent --zone=internal --add-rich-rule='
rule family="ipv4" source address="192.168.1.100" drop'

# è§„åˆ™2ï¼šå…è®¸ 192.168.1.100 è®¿é—® SSHï¼ˆè¿™æ¡è§„åˆ™ä¸ä¼šç”Ÿæ•ˆï¼ï¼‰
firewall-cmd --permanent --zone=internal --add-rich-rule='
rule family="ipv4" source address="192.168.1.100" 
service name="ssh" accept'
```

> âš ï¸ **é‡è¦æé†’**  
> è§„åˆ™1 ä¼šå…ˆåŒ¹é…å¹¶ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œè§„åˆ™2 æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œã€‚ç¼–å†™è§„åˆ™æ—¶è¦æ³¨æ„**ä»å…·ä½“åˆ°é€šç”¨**çš„é¡ºåº

### 5.3 ä¸åŒæ¥å£é—´çš„ä¼˜å…ˆçº§


**å¤šæ¥å£ç¯å¢ƒä¸‹çš„è§„åˆ™å¤„ç†**ï¼š
```bash
# åœºæ™¯ï¼šæ•°æ®åŒ…ä» eth0 è¿›å…¥ï¼Œç›®æ ‡æ˜¯æœåŠ¡å™¨ä¸Šçš„æœåŠ¡

å¤„ç†é€»è¾‘ï¼š
1. ç¡®å®šæ•°æ®åŒ…è¿›å…¥çš„æ¥å£ï¼ˆeth0ï¼‰
2. æŸ¥æ‰¾ eth0 æ‰€å±çš„ Zoneï¼ˆå‡è®¾æ˜¯ externalï¼‰
3. åº”ç”¨ external Zone çš„æ‰€æœ‰è§„åˆ™
4. å…¶ä»– Zone çš„è§„åˆ™ä¸ä¼šå½±å“è¿™ä¸ªæ•°æ®åŒ…
```

**è·¨æ¥å£é€šä¿¡è§„åˆ™**ï¼š
```bash
# å…è®¸å†…ç½‘æ¥å£è®¿é—®å¤–ç½‘æ¥å£ä¸Šçš„æœåŠ¡
# éœ€è¦åœ¨ä¸¤ä¸ª Zone éƒ½è¿›è¡Œé…ç½®

# åœ¨å†…ç½‘ Zone å…è®¸å‡ºç«™
firewall-cmd --permanent --zone=internal --add-service=http

# åœ¨å¤–ç½‘ Zone å…è®¸æ¥è‡ªå†…ç½‘çš„å…¥ç«™
firewall-cmd --permanent --zone=external --add-rich-rule='
rule family="ipv4" source address="192.168.1.0/24" 
service name="http" accept'
```

---

## 6. ğŸ–¥ï¸ å¤šç½‘å¡ç¯å¢ƒé…ç½®å®æˆ˜


### 6.1 å…¸å‹å¤šç½‘å¡æœåŠ¡å™¨åœºæ™¯


**å¸¸è§çš„ä¸‰ç½‘å¡æœåŠ¡å™¨é…ç½®**ï¼š
```
æœåŠ¡å™¨è§’è‰²ï¼šWeb + æ•°æ®åº“æœåŠ¡å™¨

ç½‘å¡åˆ†å·¥ï¼š
eth0 (å¤–ç½‘å¡) â†’ è¿æ¥äº’è”ç½‘ï¼Œæä¾› Web æœåŠ¡
eth1 (å†…ç½‘å¡) â†’ è¿æ¥å†…ç½‘ï¼Œæä¾›æ•°æ®åº“æœåŠ¡  
eth2 (ç®¡ç†å¡) â†’ è¿æ¥ç®¡ç†ç½‘ç»œï¼Œç³»ç»Ÿç»´æŠ¤ä¸“ç”¨

IP è§„åˆ’ï¼š
eth0: 203.0.113.10/24 (å…¬ç½‘IP)     â†’ external zone
eth1: 192.168.100.10/24 (å†…ç½‘IP)   â†’ internal zone  
eth2: 10.10.10.10/24 (ç®¡ç†ç½‘IP)    â†’ trusted zone
```

### 6.2 åˆ†æ­¥é…ç½®å¤šç½‘å¡é˜²ç«å¢™


**ç¬¬ä¸€æ­¥ï¼šæ¥å£å’Œ Zone ç»‘å®š**ï¼š
```bash
# ç»‘å®šå¤–ç½‘æ¥å£åˆ° external zone
firewall-cmd --permanent --zone=external --change-interface=eth0

# ç»‘å®šå†…ç½‘æ¥å£åˆ° internal zone  
firewall-cmd --permanent --zone=internal --change-interface=eth1

# ç»‘å®šç®¡ç†æ¥å£åˆ° trusted zone
firewall-cmd --permanent --zone=trusted --change-interface=eth2

# é‡è½½é…ç½®
firewall-cmd --reload
```

**ç¬¬äºŒæ­¥ï¼šé…ç½®å¤–ç½‘æ¥å£ï¼ˆWeb æœåŠ¡ï¼‰**ï¼š
```bash
# åªå¼€æ”¾ Web ç›¸å…³ç«¯å£
firewall-cmd --permanent --zone=external --add-service=http
firewall-cmd --permanent --zone=external --add-service=https

# å¼€æ”¾ SSHï¼Œä½†é™åˆ¶è®¿é—®é¢‘ç‡
firewall-cmd --permanent --zone=external --add-rich-rule='
rule family="ipv4" service name="ssh" 
limit value="3/m" accept'

# å¯ç”¨åœ°å€ä¼ªè£…ï¼ˆå¦‚æœéœ€è¦ NATï¼‰
firewall-cmd --permanent --zone=external --add-masquerade
```

**ç¬¬ä¸‰æ­¥ï¼šé…ç½®å†…ç½‘æ¥å£ï¼ˆæ•°æ®åº“æœåŠ¡ï¼‰**ï¼š
```bash
# å¼€æ”¾æ•°æ®åº“ç«¯å£ç»™å†…ç½‘
firewall-cmd --permanent --zone=internal --add-service=mysql
firewall-cmd --permanent --zone=internal --add-port=5432/tcp  # PostgreSQL

# å…è®¸å†…ç½‘æ®µè®¿é—®
firewall-cmd --permanent --zone=internal --add-source=192.168.100.0/24

# å¼€æ”¾æ–‡ä»¶å…±äº«æœåŠ¡
firewall-cmd --permanent --zone=internal --add-service=nfs
firewall-cmd --permanent --zone=internal --add-service=samba
```

**ç¬¬å››æ­¥ï¼šé…ç½®ç®¡ç†æ¥å£ï¼ˆè¿ç»´ä¸“ç”¨ï¼‰**ï¼š
```bash
# å®Œå…¨ä¿¡ä»»ç®¡ç†ç½‘ç»œ
firewall-cmd --permanent --zone=trusted --set-target=ACCEPT

# æˆ–è€…ç²¾ç¡®æ§åˆ¶ç®¡ç†æœåŠ¡
firewall-cmd --permanent --zone=trusted --add-service=ssh
firewall-cmd --permanent --zone=trusted --add-port=9090/tcp  # ç›‘æ§
firewall-cmd --permanent --zone=trusted --add-port=8080/tcp  # ç®¡ç†ç•Œé¢
```

### 6.3 éªŒè¯å¤šç½‘å¡é…ç½®


**é…ç½®éªŒè¯å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹å„æ¥å£æ‰€å± Zone
firewall-cmd --get-active-zones

# æ£€æŸ¥æ¯ä¸ª Zone çš„è§„åˆ™
firewall-cmd --zone=external --list-all
firewall-cmd --zone=internal --list-all  
firewall-cmd --zone=trusted --list-all

# æµ‹è¯•ç«¯å£è¿é€šæ€§
nmap -p 80,443 203.0.113.10      # æµ‹è¯•å¤–ç½‘ Web ç«¯å£
nmap -p 3306 192.168.100.10      # æµ‹è¯•å†…ç½‘æ•°æ®åº“ç«¯å£
nmap -p 22 10.10.10.10           # æµ‹è¯•ç®¡ç†ç½‘ SSH ç«¯å£
```

---

## 7. ğŸ”§ è™šæ‹Ÿæ¥å£å¤„ç†æ–¹æ¡ˆ


### 7.1 è™šæ‹Ÿæ¥å£ç±»å‹è¯†åˆ«


**å¸¸è§çš„è™šæ‹Ÿæ¥å£ç±»å‹**ï¼š
```
ç‰©ç†æ¥å£ï¼šeth0, ens33, enp0s3
è™šæ‹Ÿæ¥å£ï¼š
â”œâ”€â”€ VLAN æ¥å£ï¼šeth0.100, eth0.200
â”œâ”€â”€ æ¡¥æ¥å£ï¼šbr0, virbr0  
â”œâ”€â”€ éš§é“æ¥å£ï¼štun0, tap0
â”œâ”€â”€ è™šæ‹Ÿä»¥å¤ªç½‘ï¼šveth0, veth1
â”œâ”€â”€ Docker æ¥å£ï¼šdocker0
â”œâ”€â”€ VPN æ¥å£ï¼šppp0, wg0
â””â”€â”€ å›ç¯æ¥å£ï¼šlo
```

**è¯†åˆ«è™šæ‹Ÿæ¥å£**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£ç±»å‹
ip link show

# è¾“å‡ºç¤ºä¾‹è§£è¯»ï¼š
# eth0: <BROADCAST,MULTICAST,UP>     â†’ ç‰©ç†ç½‘å¡
# br0: <BROADCAST,MULTICAST,UP>      â†’ æ¡¥æ¥è®¾å¤‡  
# docker0: <BROADCAST,MULTICAST,UP>  â†’ Docker ç½‘æ¡¥
# tun0: <POINTOPOINT,UP>             â†’ éš§é“æ¥å£
```

### 7.2 VLAN è™šæ‹Ÿæ¥å£é…ç½®


**VLAN æ¥å£çš„é˜²ç«å¢™ç®¡ç†**ï¼š
```bash
# å‡è®¾ eth0.100 æ˜¯ VLAN 100ï¼ˆDMZåŒºï¼‰
# eth0.200 æ˜¯ VLAN 200ï¼ˆåŠå…¬åŒºï¼‰

# ä¸ºä¸åŒ VLAN é…ç½®ä¸åŒå®‰å…¨çº§åˆ«
firewall-cmd --permanent --zone=dmz --change-interface=eth0.100
firewall-cmd --permanent --zone=work --change-interface=eth0.200

# DMZ åŒºé…ç½®ï¼šä¸¥æ ¼æ§åˆ¶
firewall-cmd --permanent --zone=dmz --add-service=http  
firewall-cmd --permanent --zone=dmz --add-service=https

# åŠå…¬åŒºé…ç½®ï¼šç›¸å¯¹å®½æ¾
firewall-cmd --permanent --zone=work --add-service=ssh
firewall-cmd --permanent --zone=work --add-service=samba
firewall-cmd --permanent --zone=work --add-port=8000-9000/tcp
```

### 7.3 å®¹å™¨ç½‘ç»œæ¥å£å¤„ç†


**Docker æ¥å£ç®¡ç†**ï¼š
```bash
# Docker é»˜è®¤åˆ›å»º docker0 ç½‘æ¡¥
# é€šå¸¸å°†å…¶ç½®äº trusted zone

firewall-cmd --permanent --zone=trusted --change-interface=docker0

# æˆ–è€…åˆ›å»ºä¸“ç”¨çš„å®¹å™¨ zone
firewall-cmd --permanent --new-zone=containers
firewall-cmd --permanent --zone=containers --change-interface=docker0
firewall-cmd --permanent --zone=containers --set-target=ACCEPT
```

> ğŸ’¡ **Docker ç‰¹æ®Šè¯´æ˜**  
> Docker æœ‰è‡ªå·±çš„ iptables è§„åˆ™ç®¡ç†æœºåˆ¶ï¼Œå¯èƒ½ä¸ Firewalld äº§ç”Ÿå†²çªã€‚å»ºè®®ä½¿ç”¨ Docker çš„ç½‘ç»œç­–ç•¥æˆ–å°† Docker æ¥å£æ”¾åœ¨ trusted zone

### 7.4 VPN æ¥å£å®‰å…¨é…ç½®


**VPN éš§é“æ¥å£å¤„ç†**ï¼š
```bash
# OpenVPN æ¥å£ tun0
firewall-cmd --permanent --zone=internal --change-interface=tun0

# WireGuard æ¥å£ wg0  
firewall-cmd --permanent --zone=internal --change-interface=wg0

# VPN å®¢æˆ·ç«¯è®¿é—®æ§åˆ¶
firewall-cmd --permanent --zone=internal --add-rich-rule='
rule family="ipv4" source address="10.8.0.0/24" 
service name="ssh" accept'

# å…è®¸ VPN å®¢æˆ·ç«¯è®¿é—®å†…ç½‘èµ„æº
firewall-cmd --permanent --zone=internal --add-service=samba
firewall-cmd --permanent --zone=internal --add-service=rdp
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¥å£å®‰å…¨çº§åˆ«ï¼šä¸åŒç½‘ç»œæ¥å£é…ç½®ä¸åŒçš„å®‰å…¨ç­–ç•¥
ğŸ”¸ Zone å®‰å…¨åŸŸï¼šé¢„å®šä¹‰çš„å®‰å…¨çº§åˆ«æ¨¡æ¿ï¼Œä» drop åˆ° trusted
ğŸ”¸ æ¥å£ç»‘å®šï¼šä¸€ä¸ªæ¥å£åªèƒ½å±äºä¸€ä¸ª Zoneï¼Œä¸€ä¸ª Zone å¯ä»¥åŒ…å«å¤šä¸ªæ¥å£
ğŸ”¸ å·®å¼‚åŒ–é…ç½®ï¼šå†…ç½‘å®½æ¾ï¼Œå¤–ç½‘ä¸¥æ ¼ï¼Œç®¡ç†ç½‘å¯ä¿¡
ğŸ”¸ è§„åˆ™ä¼˜å…ˆçº§ï¼šç›´æ¥è§„åˆ™ > å¯Œè§„åˆ™ > æœåŠ¡è§„åˆ™ > ç«¯å£è§„åˆ™ > Zone é»˜è®¤
ğŸ”¸ è™šæ‹Ÿæ¥å£ï¼šVLANã€Dockerã€VPN ç­‰è™šæ‹Ÿæ¥å£éœ€è¦ç‰¹æ®Šå¤„ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦æ¥å£çº§åˆ«å®‰å…¨é…ç½®**ï¼š
```
ç½‘ç»œéš”ç¦»éœ€æ±‚ï¼š
- å¤–ç½‘æ¥å£é¢å‘äº’è”ç½‘ï¼Œå¨èƒæœ€å¤§
- å†…ç½‘æ¥å£é¢å‘å¯ä¿¡ç½‘ç»œï¼Œéœ€è¦ä¾¿æ°‘
- ç®¡ç†æ¥å£é¢å‘è¿ç»´äººå‘˜ï¼Œéœ€è¦åŠŸèƒ½å®Œæ•´

å®é™…ä¸šåŠ¡éœ€æ±‚ï¼š
- Web æœåŠ¡åªåœ¨å¤–ç½‘æ¥å£å¼€æ”¾
- æ•°æ®åº“æœåŠ¡åªåœ¨å†…ç½‘æ¥å£å¼€æ”¾  
- ç›‘æ§æœåŠ¡åªåœ¨ç®¡ç†æ¥å£å¼€æ”¾
```

**ğŸ”¹ å®‰å…¨åŸŸé€‰æ‹©åŸåˆ™**ï¼š
```
é€‰æ‹©ä¾æ®ï¼š
ç½‘ç»œä¿¡ä»»åº¦ + ä¸šåŠ¡éœ€æ±‚ + å®‰å…¨è¦æ±‚

å¸¸ç”¨æ­é…ï¼š
external + public  â†’ é¢å‘äº’è”ç½‘
internal + work    â†’ é¢å‘åŠå…¬ç½‘ç»œ
trusted           â†’ é¢å‘ç®¡ç†ç½‘ç»œ
dmz              â†’ é¢å‘ DMZ åŒºåŸŸ
```

**ğŸ”¹ å¤šç½‘å¡é…ç½®æ€è·¯**ï¼š
```
è§„åˆ’é˜¶æ®µï¼š
1. æ˜ç¡®ç½‘å¡ç”¨é€”ï¼ˆå¤–ç½‘/å†…ç½‘/ç®¡ç†ï¼‰
2. é€‰æ‹©åˆé€‚çš„å®‰å…¨åŸŸ
3. è§„åˆ’æœåŠ¡å¼€æ”¾ç­–ç•¥

å®æ–½é˜¶æ®µï¼š
1. æ¥å£ä¸ Zone ç»‘å®š
2. é…ç½®å„ Zone çš„è§„åˆ™
3. æµ‹è¯•éªŒè¯è¿é€šæ€§

ç»´æŠ¤é˜¶æ®µï¼š
1. å®šæœŸæ£€æŸ¥è§„åˆ™æœ‰æ•ˆæ€§  
2. æ ¹æ®ä¸šåŠ¡å˜åŒ–è°ƒæ•´è§„åˆ™
3. ç›‘æ§æ—¥å¿—å¼‚å¸¸è®¿é—®
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
- [x] ç¡®è®¤æ¥å£ä¸ Zone ç»‘å®šæ­£ç¡®
- [x] éªŒè¯å„æ¥å£å¼€æ”¾çš„æœåŠ¡åˆç†
- [x] æ£€æŸ¥è§„åˆ™ä¼˜å…ˆçº§æ˜¯å¦ç¬¦åˆé¢„æœŸ
- [x] æµ‹è¯•å„æ¥å£çš„è¿é€šæ€§
- [x] ç¡®è®¤è™šæ‹Ÿæ¥å£å¤„ç†å¾—å½“
- [x] å®šæœŸå¤‡ä»½é˜²ç«å¢™é…ç½®

**æ•…éšœæ’æŸ¥è¦ç‚¹**ï¼š
- ğŸ” **è¿æ¥è¢«æ‹’ç»**ï¼šæ£€æŸ¥ç›®æ ‡æ¥å£æ‰€åœ¨ Zone çš„è§„åˆ™
- ğŸ” **æœåŠ¡æ— æ³•è®¿é—®**ï¼šç¡®è®¤æœåŠ¡æ˜¯å¦åœ¨æ­£ç¡®çš„æ¥å£ä¸Šå¼€æ”¾
- ğŸ” **è§„åˆ™ä¸ç”Ÿæ•ˆ**ï¼šæ£€æŸ¥è§„åˆ™ä¼˜å…ˆçº§å’Œè¯­æ³•
- ğŸ” **è™šæ‹Ÿæ¥å£é—®é¢˜**ï¼šç¡®è®¤è™šæ‹Ÿæ¥å£çš„ Zone åˆ†é…

**å®‰å…¨æœ€ä½³å®è·µ**ï¼š
- ğŸ›¡ï¸ **æœ€å°æƒé™åŸåˆ™**ï¼šåªå¼€æ”¾å¿…éœ€çš„æœåŠ¡å’Œç«¯å£
- ğŸ›¡ï¸ **ç½‘ç»œåˆ†æ®µ**ï¼šä¸åŒç”¨é€”çš„æ¥å£ä½¿ç”¨ä¸åŒ Zone
- ğŸ›¡ï¸ **å®šæœŸå®¡è®¡**ï¼šæ£€æŸ¥é˜²ç«å¢™è§„åˆ™çš„æœ‰æ•ˆæ€§
- ğŸ›¡ï¸ **æ—¥å¿—ç›‘æ§**ï¼šå…³æ³¨å¼‚å¸¸è®¿é—®å’Œæ”»å‡»å°è¯•
- ğŸ›¡ï¸ **æµ‹è¯•éªŒè¯**ï¼šé…ç½®å˜æ›´åå¿…é¡»æµ‹è¯•åŠŸèƒ½

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ¥å£åˆ†ç±»è¦æ¸…æ™°ï¼Œå†…å¤–ç®¡ç†ä¸æ··æ·†
- Zone ç»‘å®šä¸€å¯¹ä¸€ï¼Œè§„åˆ™ä¼˜å…ˆè¦è®°ç‰¢  
- å¤–ç½‘ä¸¥æ ¼å†…ç½‘æ¾ï¼Œè™šæ‹Ÿæ¥å£ç‰¹æ®Šå¤„
- æµ‹è¯•éªŒè¯ä¸å¯å°‘ï¼Œå®‰å…¨è¿ç»´é ç»†å¿ƒ