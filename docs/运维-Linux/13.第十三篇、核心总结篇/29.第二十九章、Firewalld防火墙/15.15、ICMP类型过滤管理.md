---
title: 15ã€ICMPç±»å‹è¿‡æ»¤ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ICMPåè®®åŸºç¡€ç†è§£](#1-ICMPåè®®åŸºç¡€ç†è§£)
2. [ICMPç±»å‹ä¸ç½‘ç»œè¯Šæ–­](#2-ICMPç±»å‹ä¸ç½‘ç»œè¯Šæ–­)
3. [Firewalldä¸­çš„ICMPè¿‡æ»¤](#3-Firewalldä¸­çš„ICMPè¿‡æ»¤)
4. [ICMPè¿‡æ»¤è§„åˆ™é…ç½®å®æˆ˜](#4-ICMPè¿‡æ»¤è§„åˆ™é…ç½®å®æˆ˜)
5. [ç½‘ç»œè¯Šæ–­å·¥å…·çš„å½±å“](#5-ç½‘ç»œè¯Šæ–­å·¥å…·çš„å½±å“)
6. [ICMPå®‰å…¨é…ç½®ç­–ç•¥](#6-ICMPå®‰å…¨é…ç½®ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ICMPåè®®åŸºç¡€ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯ICMPåè®®


**ICMPåè®®**å°±åƒç½‘ç»œä¸–ç•Œé‡Œçš„"é‚®é€’å‘˜åé¦ˆå•"ï¼š

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
ä½ å¯„ä¿¡ç»™æœ‹å‹ â†’ é‚®é€’å‘˜å‘Šè¯‰ä½ "åœ°å€ä¸å­˜åœ¨"
ç½‘ç»œé€šä¿¡      â†’ ICMPå‘Šè¯‰ä½ "ç›®æ ‡ä¸»æœºä¸å¯è¾¾"

ICMPå…¨ç§°ï¼šInternet Control Message Protocol
ä½œç”¨ï¼šç½‘ç»œå±‚çš„æ§åˆ¶æ¶ˆæ¯åè®®
ä½ç½®ï¼šå·¥ä½œåœ¨IPå±‚ä¹‹ä¸Šï¼Œä½†ä¸ºIPå±‚æœåŠ¡
```

**ICMPçš„æ ¸å¿ƒä½œç”¨**ï¼š
- **é”™è¯¯æŠ¥å‘Š**ï¼šå‘Šè¯‰å‘é€æ–¹ç½‘ç»œå‡ºäº†ä»€ä¹ˆé—®é¢˜
- **ç½‘ç»œè¯Šæ–­**ï¼šæä¾›pingã€tracerouteç­‰å·¥å…·çš„åŸºç¡€
- **è·¯å¾„å‘ç°**ï¼šå¸®åŠ©å‘ç°ç½‘ç»œè·¯å¾„é—®é¢˜
- **æµé‡æ§åˆ¶**ï¼šåœ¨ç½‘ç»œæ‹¥å¡æ—¶å‘é€æ§åˆ¶æ¶ˆæ¯

### 1.2 ICMPæ¶ˆæ¯çš„åŸºæœ¬ç»“æ„


```
ICMPæ¶ˆæ¯ç»“æ„ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¶ˆæ¯ç±»å‹    â”‚     ä»£ç      â”‚   æ ¡éªŒå’Œ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                æ¶ˆæ¯å†…å®¹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç±»å‹ï¼ˆTypeï¼‰ï¼šè¯´æ˜è¿™æ˜¯ä»€ä¹ˆæ¶ˆæ¯ï¼ˆå¦‚pingè¯·æ±‚ï¼‰
ä»£ç ï¼ˆCodeï¼‰ï¼šæ›´è¯¦ç»†çš„åˆ†ç±»ï¼ˆå¦‚å…·ä½“çš„é”™è¯¯åŸå› ï¼‰
å†…å®¹ï¼šå…·ä½“çš„æ¶ˆæ¯æ•°æ®
```

### 1.3 ICMPä¸æ™®é€šæ•°æ®ä¼ è¾“çš„åŒºåˆ«


| ç‰¹å¾ | **æ™®é€šæ•°æ®ä¼ è¾“** | **ICMPæ¶ˆæ¯** |
|------|----------------|-------------|
| **ç›®çš„** | `ä¼ è¾“åº”ç”¨æ•°æ®` | `ä¼ è¾“æ§åˆ¶ä¿¡æ¯` |
| **å‘èµ·æ–¹** | `åº”ç”¨ç¨‹åº` | `ç³»ç»Ÿå†…æ ¸` |
| **å¤„ç†æ–¹** | `ç›®æ ‡åº”ç”¨` | `ç³»ç»Ÿå†…æ ¸` |
| **å†…å®¹** | `ç”¨æˆ·æ•°æ®` | `ç½‘ç»œçŠ¶æ€ä¿¡æ¯` |

---

## 2. ğŸ“Š ICMPç±»å‹ä¸ç½‘ç»œè¯Šæ–­


### 2.1 å¸¸è§ICMPç±»å‹è¯¦è§£


**ğŸ”¸ Echo Request/Replyï¼ˆç±»å‹8/0ï¼‰**
```
è¿™æ˜¯pingå‘½ä»¤çš„åŸºç¡€ï¼š
ä½ çš„ç”µè„‘ â†’ "ä½ è¿˜æ´»ç€å—ï¼Ÿ"ï¼ˆEcho Requestï¼Œç±»å‹8ï¼‰
ç›®æ ‡ä¸»æœº â†’ "æˆ‘è¿˜æ´»ç€ï¼"ï¼ˆEcho Replyï¼Œç±»å‹0ï¼‰

å®é™…ä½œç”¨ï¼š
- æµ‹è¯•ä¸»æœºæ˜¯å¦å¯è¾¾
- æµ‹é‡ç½‘ç»œå»¶è¿Ÿ
- éªŒè¯ç½‘ç»œè¿æ¥è´¨é‡
```

**ğŸ”¸ Destination Unreachableï¼ˆç±»å‹3ï¼‰**
```
ç½‘ç»œä¸­çš„"æ­¤è·¯ä¸é€š"æ ‡å¿—ï¼š

ä»£ç 0ï¼šç½‘ç»œä¸å¯è¾¾ â†’ è·¯ç”±å™¨æ‰¾ä¸åˆ°åˆ°ç›®æ ‡ç½‘ç»œçš„è·¯å¾„
ä»£ç 1ï¼šä¸»æœºä¸å¯è¾¾ â†’ èƒ½åˆ°ç½‘ç»œï¼Œä½†ä¸»æœºä¸å­˜åœ¨
ä»£ç 2ï¼šåè®®ä¸å¯è¾¾ â†’ ä¸»æœºå­˜åœ¨ï¼Œä½†ä¸æ”¯æŒè¯¥åè®®
ä»£ç 3ï¼šç«¯å£ä¸å¯è¾¾ â†’ ä¸»æœºå­˜åœ¨ï¼Œä½†ç«¯å£æœªå¼€æ”¾
```

**ğŸ”¸ Time Exceededï¼ˆç±»å‹11ï¼‰**
```
è¿™æ˜¯tracerouteçš„å·¥ä½œåŸç†ï¼š

ä»£ç 0ï¼šä¼ è¾“è¿‡ç¨‹ä¸­TTLè¶…æ—¶
ä½œç”¨ï¼šæ•°æ®åŒ…åœ¨ç½‘ç»œä¸­"è½¬åœˆ"å¤ªä¹…ï¼Œè¢«ä¸¢å¼ƒ
åº”ç”¨ï¼štracerouteåˆ©ç”¨è¿™ä¸ªæœºåˆ¶è¿½è¸ªè·¯å¾„
```

### 2.2 ICMPç±»å‹ä¸ç½‘ç»œå·¥å…·çš„å…³ç³»


```
ç½‘ç»œè¯Šæ–­å·¥å…· â† â†’ ICMPç±»å‹çš„å¯¹åº”å…³ç³»ï¼š

pingå‘½ä»¤ï¼š
å‘é€ï¼šEcho Requestï¼ˆç±»å‹8ï¼‰
æ¥æ”¶ï¼šEcho Replyï¼ˆç±»å‹0ï¼‰

tracerouteå‘½ä»¤ï¼š
è§¦å‘ï¼šTime Exceededï¼ˆç±»å‹11ï¼‰
åˆ©ç”¨TTLé€’å¢æ¢æµ‹æ¯è·³è·¯ç”±å™¨

ç½‘ç»œæ•…éšœè¯Šæ–­ï¼š
æ¥æ”¶ï¼šDestination Unreachableï¼ˆç±»å‹3ï¼‰
äº†è§£ï¼šå…·ä½“çš„ä¸å¯è¾¾åŸå› 
```

### 2.3 ICMPåœ¨ç½‘ç»œæ•…éšœæ’æŸ¥ä¸­çš„ä»·å€¼


```
æ•…éšœæ’æŸ¥åœºæ™¯æ¼”ç¤ºï¼š

åœºæ™¯1ï¼šç½‘ç«™æ— æ³•è®¿é—®
æ­¥éª¤1ï¼špingç›®æ ‡IP â†’ æµ‹è¯•åŸºç¡€è¿é€šæ€§
æ­¥éª¤2ï¼štraceroute â†’ æ‰¾åˆ°æ•…éšœèŠ‚ç‚¹
æ­¥éª¤3ï¼šæ£€æŸ¥ICMPå“åº” â†’ ç¡®å®šé—®é¢˜ç±»å‹

åœºæ™¯2ï¼šåº”ç”¨è¿æ¥è¶…æ—¶
æ£€æŸ¥ï¼šæ˜¯å¦æ”¶åˆ°Port Unreachableï¼ˆç±»å‹3ä»£ç 3ï¼‰
ç»“è®ºï¼šç«¯å£æœªå¼€æ”¾æˆ–é˜²ç«å¢™é˜»æ‹¦
```

---

## 3. ğŸ”¥ Firewalldä¸­çš„ICMPè¿‡æ»¤


### 3.1 ä¸ºä»€ä¹ˆè¦è¿‡æ»¤ICMP


**å®‰å…¨è€ƒè™‘**ï¼š
```
ICMPçš„"åŒåˆƒå‰‘"ç‰¹æ€§ï¼š

æœ‰ç”¨ä¹‹å¤„ï¼š
âœ… ç½‘ç»œè¯Šæ–­å¿…ä¸å¯å°‘
âœ… å¸®åŠ©å‘ç°ç½‘ç»œé—®é¢˜
âœ… æä¾›è¿æ¥çŠ¶æ€åé¦ˆ

æ½œåœ¨é£é™©ï¼š
âš ï¸ ä¿¡æ¯æ³„éœ²ï¼šæš´éœ²å†…ç½‘ç»“æ„
âš ï¸ DDoSæ”»å‡»ï¼špingæ´ªæ°´æ”»å‡»
âš ï¸ ç½‘ç»œæ¢æµ‹ï¼šé»‘å®¢ä¾¦å¯Ÿå·¥å…·
```

**å®é™…åº”ç”¨ç­–ç•¥**ï¼š
- **å†…ç½‘**ï¼šé€šå¸¸å…è®¸ICMPï¼Œä¾¿äºç®¡ç†
- **è¾¹ç•Œé˜²ç«å¢™**ï¼šé€‰æ‹©æ€§é˜»æ­¢ï¼Œé˜²æ­¢æ¢æµ‹
- **æœåŠ¡å™¨**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚ç²¾ç¡®æ§åˆ¶

### 3.2 Firewalldçš„ICMPå¤„ç†æœºåˆ¶


```
Firewalldå¤„ç†ICMPçš„å±‚æ¬¡ç»“æ„ï¼š

Zoneç­–ç•¥
    â†“
ICMPç±»å‹è§„åˆ™  â† æœ¬ç« é‡ç‚¹
    â†“
å…·ä½“çš„å…è®¸/æ‹’ç»åŠ¨ä½œ
```

**ICMPè¿‡æ»¤çš„ç‰¹ç‚¹**ï¼š
- **ç±»å‹çº§æ§åˆ¶**ï¼šå¯ä»¥æ§åˆ¶ç‰¹å®šçš„ICMPç±»å‹
- **æ–¹å‘æ€§**ï¼šå¯ä»¥æ§åˆ¶å…¥ç«™/å‡ºç«™ICMP
- **Zoneç»§æ‰¿**ï¼šéµå¾ªZoneçš„é»˜è®¤ç­–ç•¥

---

## 4. âš™ï¸ ICMPè¿‡æ»¤è§„åˆ™é…ç½®å®æˆ˜


### 4.1 æŸ¥çœ‹å¯ç”¨çš„ICMPç±»å‹


**æŸ¥çœ‹ç³»ç»Ÿæ”¯æŒçš„ICMPç±»å‹**ï¼š
```bash
# åˆ—å‡ºæ‰€æœ‰é¢„å®šä¹‰çš„ICMPç±»å‹
firewall-cmd --get-icmptypes

# å¸¸è§è¾“å‡ºç¤ºä¾‹
echo-reply
echo-request
destination-unreachable
time-exceeded
parameter-problem
source-quench
redirect
router-advertisement
router-solicitation
```

**æŸ¥çœ‹ç‰¹å®šICMPç±»å‹çš„è¯¦ç»†ä¿¡æ¯**ï¼š
```bash
# æŸ¥çœ‹echo-requestçš„è¯¦ç»†ä¿¡æ¯
firewall-cmd --info-icmptype=echo-request

# è¾“å‡ºç¤ºä¾‹è§£è¯»
echo-request
  description: Echo request packets are sent to probe hosts.
  destination: ipv4 ipv6
```

### 4.2 ICMPç±»å‹çš„åŸºæœ¬æ“ä½œ


**ğŸ”¸ æŸ¥çœ‹å½“å‰Zoneçš„ICMPé…ç½®**

```bash
# æŸ¥çœ‹é»˜è®¤zoneçš„ICMPè§„åˆ™
firewall-cmd --list-icmp-blocks

# æŸ¥çœ‹ç‰¹å®šzoneçš„ICMPè§„åˆ™
firewall-cmd --zone=public --list-icmp-blocks

# æŸ¥çœ‹æ‰€æœ‰zoneçš„å®Œæ•´é…ç½®
firewall-cmd --list-all-zones | grep -A5 -B5 icmp
```

**ğŸ”¸ é˜»æ­¢ç‰¹å®šICMPç±»å‹**

```bash
# é˜»æ­¢pingè¯·æ±‚ï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼‰
firewall-cmd --add-icmp-block=echo-request

# é˜»æ­¢pingè¯·æ±‚ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰
firewall-cmd --permanent --add-icmp-block=echo-request
firewall-cmd --reload

# åœ¨ç‰¹å®šzoneä¸­é˜»æ­¢
firewall-cmd --zone=public --permanent --add-icmp-block=echo-request
```

**ğŸ”¸ å…è®¸ç‰¹å®šICMPç±»å‹**

```bash
# ç§»é™¤ICMPé˜»æ­¢è§„åˆ™ï¼ˆå…è®¸ï¼‰
firewall-cmd --remove-icmp-block=echo-request

# æ°¸ä¹…ç§»é™¤é˜»æ­¢
firewall-cmd --permanent --remove-icmp-block=echo-request
firewall-cmd --reload
```

### 4.3 å®é™…é…ç½®åœºæ™¯æ¼”ç¤º


**åœºæ™¯1ï¼šç¦æ­¢å¤–éƒ¨pingæœåŠ¡å™¨**
```bash
# ç›®æ ‡ï¼šé˜»æ­¢å¤–éƒ¨å¯¹æœåŠ¡å™¨çš„pingæ¢æµ‹
# æ–¹æ³•ï¼šé˜»æ­¢echo-request

# 1. ç¡®è®¤å½“å‰çŠ¶æ€
firewall-cmd --list-icmp-blocks

# 2. æ·»åŠ é˜»æ­¢è§„åˆ™
firewall-cmd --permanent --add-icmp-block=echo-request

# 3. é‡è½½é…ç½®
firewall-cmd --reload

# 4. éªŒè¯é…ç½®
firewall-cmd --list-icmp-blocks
```

**éªŒè¯æ•ˆæœ**ï¼š
```bash
# ä»å¤–éƒ¨pingæœåŠ¡å™¨
ping your-server-ip
# åº”è¯¥æ˜¾ç¤ºï¼šRequest timeout æˆ–æ— å“åº”

# æ³¨æ„ï¼šæœåŠ¡å™¨ä»å¯ä»¥ä¸»åŠ¨pingå¤–éƒ¨
ping 8.8.8.8  # è¿™ä¸ªä»ç„¶å·¥ä½œæ­£å¸¸
```

**åœºæ™¯2ï¼šé˜»æ­¢tracerouteæ¢æµ‹**
```bash
# tracerouteä¾èµ–Time Exceededæ¶ˆæ¯
# é˜»æ­¢time-exceededå¯ä»¥å½±å“traceroute

firewall-cmd --permanent --add-icmp-block=time-exceeded
firewall-cmd --reload
```

### 4.4 é«˜çº§ICMPè¿‡æ»¤é…ç½®


**ğŸ”¸ åˆ›å»ºè‡ªå®šä¹‰ICMPè§„åˆ™é›†**

```bash
# åˆ›å»ºä¸¥æ ¼çš„ICMPç­–ç•¥ï¼ˆé€‚ç”¨äºç”Ÿäº§æœåŠ¡å™¨ï¼‰
# é˜»æ­¢å¸¸è§çš„æ¢æµ‹ç±»å‹

firewall-cmd --permanent --add-icmp-block=echo-request      # ç¦ping
firewall-cmd --permanent --add-icmp-block=timestamp-request # ç¦æ—¶é—´æˆ³è¯·æ±‚
firewall-cmd --permanent --add-icmp-block=address-mask-request # ç¦åœ°å€æ©ç è¯·æ±‚

# é‡è½½å¹¶éªŒè¯
firewall-cmd --reload
firewall-cmd --list-icmp-blocks
```

**ğŸ”¸ é’ˆå¯¹ä¸åŒZoneçš„å·®å¼‚åŒ–é…ç½®**

```bash
# å†…ç½‘zoneï¼ˆtrustedï¼‰ï¼šå…è®¸æ‰€æœ‰ICMP
firewall-cmd --zone=trusted --permanent --remove-icmp-block=echo-request

# å…¬ç½‘zoneï¼ˆpublicï¼‰ï¼šä¸¥æ ¼é™åˆ¶ICMP
firewall-cmd --zone=public --permanent --add-icmp-block=echo-request
firewall-cmd --zone=public --permanent --add-icmp-block=timestamp-request

firewall-cmd --reload
```

---

## 5. ğŸ” ç½‘ç»œè¯Šæ–­å·¥å…·çš„å½±å“


### 5.1 ICMPè¿‡æ»¤å¯¹pingçš„å½±å“


**æ­£å¸¸pingå·¥ä½œæµç¨‹**ï¼š
```
å®¢æˆ·ç«¯                  æœåŠ¡å™¨
   |                      |
   |--[Echo Request]----->|
   |                      |
   |<--[Echo Reply]-------|
   |                      |
ç»“æœï¼špingæˆåŠŸï¼Œæ˜¾ç¤ºå»¶è¿Ÿæ—¶é—´
```

**é˜»æ­¢echo-requeståçš„æ•ˆæœ**ï¼š
```
å®¢æˆ·ç«¯                  é˜²ç«å¢™                æœåŠ¡å™¨
   |                      |                     |
   |--[Echo Request]----->|--[ä¸¢å¼ƒ]              |
   |                      |                     |
   |    [è¶…æ—¶ç­‰å¾…]        |                     |
   |                      |                     |
ç»“æœï¼šRequest timeoutï¼Œpingå¤±è´¥
```

### 5.2 ICMPè¿‡æ»¤å¯¹tracerouteçš„å½±å“


**tracerouteåŸç†ç®€è¿°**ï¼š
```
tracerouteé€šè¿‡é€’å¢TTLå€¼æ¥æ¢æµ‹è·¯å¾„ï¼š

TTL=1 â†’ ç¬¬ä¸€è·³è·¯ç”±å™¨ â†’ è¿”å›Time Exceeded
TTL=2 â†’ ç¬¬äºŒè·³è·¯ç”±å™¨ â†’ è¿”å›Time Exceeded
...
ç›´åˆ°åˆ°è¾¾ç›®æ ‡ä¸»æœº
```

**é˜»æ­¢time-exceededçš„å½±å“**ï¼š
```bash
# æ­£å¸¸tracerouteè¾“å‡º
traceroute google.com
 1  router.local (192.168.1.1)  1.234 ms
 2  isp-gateway (10.0.0.1)     15.678 ms
 3  * * *  # è¿™é‡Œå¯èƒ½æ˜¯é˜»æ­¢äº†time-exceededçš„èŠ‚ç‚¹

# å½±å“åˆ†æï¼š
- éƒ¨åˆ†è·³æ•°æ˜¾ç¤ºä¸º * * *
- æ— æ³•å‡†ç¡®è¿½è¸ªå®Œæ•´è·¯å¾„
- è¯Šæ–­ç½‘ç»œé—®é¢˜å˜å›°éš¾
```

### 5.3 ç½‘ç»œè¯Šæ–­çš„æƒè¡¡ç­–ç•¥


**ğŸ”¸ æ¨èçš„ICMPé…ç½®ç­–ç•¥**

| ç¯å¢ƒç±»å‹ | **Echo Request** | **Time Exceeded** | **Dest Unreachable** | **ç†ç”±** |
|---------|-----------------|-------------------|---------------------|----------|
| **å†…ç½‘æœåŠ¡å™¨** | `å…è®¸` | `å…è®¸` | `å…è®¸` | `ä¾¿äºç®¡ç†å’Œè¯Šæ–­` |
| **è¾¹ç•ŒæœåŠ¡å™¨** | `é˜»æ­¢` | `å…è®¸` | `å…è®¸` | `é˜²æ¢æµ‹ï¼Œä¿ç•™è¯Šæ–­` |
| **å…¬ç½‘æœåŠ¡å™¨** | `é˜»æ­¢` | `é€‰æ‹©æ€§é˜»æ­¢` | `å…è®¸` | `æœ€å°æš´éœ²åŸåˆ™` |

**ğŸ”¸ ä¿æŒè¯Šæ–­èƒ½åŠ›çš„æœ€å°åŒ–é…ç½®**

```bash
# æ—¢ä¿è¯å®‰å…¨åˆä¿ç•™å¿…è¦è¯Šæ–­èƒ½åŠ›çš„é…ç½®
# é˜»æ­¢ä¸»åŠ¨æ¢æµ‹ï¼Œä¿ç•™é”™è¯¯æŠ¥å‘Š

firewall-cmd --permanent --add-icmp-block=echo-request
firewall-cmd --permanent --add-icmp-block=timestamp-request
firewall-cmd --permanent --add-icmp-block=address-mask-request

# ä¿ç•™è¿™äº›ç”¨äºç½‘ç»œè¯Šæ–­ï¼š
# - destination-unreachableï¼ˆé”™è¯¯æŠ¥å‘Šï¼‰
# - time-exceededï¼ˆè·¯å¾„è¯Šæ–­ï¼‰
# - parameter-problemï¼ˆåè®®é”™è¯¯ï¼‰

firewall-cmd --reload
```

---

## 6. ğŸ›¡ï¸ ICMPå®‰å…¨é…ç½®ç­–ç•¥


### 6.1 å¸¸è§ICMPå®‰å…¨å¨èƒ


**ğŸ”¸ ä¿¡æ¯æ³„éœ²é£é™©**
```
é£é™©åœºæ™¯ï¼š
æ”»å‡»è€…é€šè¿‡pingæ‰«æ â†’ å‘ç°å­˜æ´»ä¸»æœº
æ”»å‡»è€…é€šè¿‡traceroute â†’ äº†è§£ç½‘ç»œæ‹“æ‰‘
æ”»å‡»è€…é€šè¿‡timestampè¯·æ±‚ â†’ è·å–ç³»ç»Ÿæ—¶é—´

é˜²æŠ¤æªæ–½ï¼š
é€‰æ‹©æ€§é˜»æ­¢echo-request â†’ éšè—ä¸»æœºå­˜åœ¨
é˜»æ­¢timestampç›¸å…³ â†’ é¿å…æ—¶é—´ä¿¡æ¯æ³„éœ²
```

**ğŸ”¸ æ‹’ç»æœåŠ¡æ”»å‡»**
```
æ”»å‡»ç±»å‹ï¼š
Pingæ´ªæ°´ â†’ å¤§é‡echo-requestæ¶ˆè€—èµ„æº
Smurfæ”»å‡» â†’ åˆ©ç”¨å¹¿æ’­pingè¿›è¡Œæ”¾å¤§æ”»å‡»

é˜²æŠ¤æªæ–½ï¼š
é™åˆ¶ICMPé€Ÿç‡ â†’ é˜²æ­¢æ´ªæ°´æ”»å‡»
é˜»æ­¢å¹¿æ’­ping â†’ é˜²æ­¢æ”¾å¤§æ”»å‡»
```

### 6.2 åˆ†å±‚é˜²æŠ¤ç­–ç•¥


**ğŸ”¸ ç½‘ç»œè¾¹ç•Œé˜²æŠ¤**
```bash
# è¾¹ç•Œè·¯ç”±å™¨/é˜²ç«å¢™é…ç½®
# ç›®æ ‡ï¼šéšè—å†…ç½‘ç»“æ„

# 1. é˜»æ­¢å¤–éƒ¨å¯¹å†…ç½‘çš„pingæ¢æµ‹
firewall-cmd --zone=external --permanent --add-icmp-block=echo-request

# 2. é˜»æ­¢ç½‘ç»œæ‹“æ‰‘æ¢æµ‹
firewall-cmd --zone=external --permanent --add-icmp-block=router-advertisement
firewall-cmd --zone=external --permanent --add-icmp-block=router-solicitation

# 3. é˜»æ­¢æ—¶é—´æˆ³è¯·æ±‚
firewall-cmd --zone=external --permanent --add-icmp-block=timestamp-request
firewall-cmd --zone=external --permanent --add-icmp-block=timestamp-reply
```

**ğŸ”¸ æœåŠ¡å™¨å±‚é¢é˜²æŠ¤**
```bash
# å…¬ç½‘æœåŠ¡å™¨çš„ICMPé…ç½®
# ç›®æ ‡ï¼šæœ€å°åŒ–æš´éœ²ï¼Œä¿ç•™å¿…è¦åŠŸèƒ½

# é˜»æ­¢æ¢æµ‹ç±»ICMP
firewall-cmd --permanent --add-icmp-block=echo-request
firewall-cmd --permanent --add-icmp-block=address-mask-request
firewall-cmd --permanent --add-icmp-block=address-mask-reply

# ä¿ç•™é”™è¯¯æŠ¥å‘Šç±»ICMPï¼ˆå¯¹åº”ç”¨æœ‰ç›Šï¼‰
# destination-unreachable, time-exceeded ç­‰ä¿æŒå…è®¸

firewall-cmd --reload
```

### 6.3 ç›‘æ§å’Œæ—¥å¿—é…ç½®


**ğŸ”¸ ICMPæµé‡ç›‘æ§**
```bash
# å¯ç”¨firewalldæ—¥å¿—è®°å½•ICMP
firewall-cmd --set-log-denied=all

# æŸ¥çœ‹ICMPç›¸å…³æ—¥å¿—
journalctl -u firewalld | grep ICMP
tail -f /var/log/messages | grep ICMP
```

**ğŸ”¸ ICMPå¼‚å¸¸æ£€æµ‹**
```bash
# ç›‘æ§å¤§é‡ICMPè¯·æ±‚ï¼ˆå¯èƒ½çš„æ”»å‡»ï¼‰
# å¯ä»¥ç»“åˆfail2banç­‰å·¥å…·

# ç®€å•çš„ç›‘æ§è„šæœ¬ç¤ºä¾‹æ€è·¯ï¼š
# 1. ç»Ÿè®¡å•ä½æ—¶é—´å†…çš„ICMPè¯·æ±‚æ•°é‡
# 2. è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘å‘Šè­¦
# 3. è‡ªåŠ¨åŠ å¼ºé˜²æŠ¤æªæ–½
```

### 6.4 ä¸šåŠ¡å½±å“è¯„ä¼°


**ğŸ”¸ é…ç½®å‰çš„è¯„ä¼°æ¸…å•**

| è¯„ä¼°é¡¹ç›® | **æ£€æŸ¥è¦ç‚¹** | **å½±å“è¯´æ˜** |
|----------|-------------|-------------|
| **ç›‘æ§ç³»ç»Ÿ** | `æ˜¯å¦ä¾èµ–pingæ£€æŸ¥` | `å¯èƒ½å½±å“å¯ç”¨æ€§ç›‘æ§` |
| **è´Ÿè½½å‡è¡¡** | `å¥åº·æ£€æŸ¥æ–¹å¼` | `pingæ–¹å¼å¥åº·æ£€æŸ¥å¤±æ•ˆ` |
| **è¿ç»´å·¥å…·** | `ç½‘ç»œè¯Šæ–­éœ€æ±‚` | `tracerouteç­‰å·¥å…·å—é™` |
| **åº”ç”¨ç¨‹åº** | `æ˜¯å¦ä½¿ç”¨ICMP` | `æŸäº›åº”ç”¨å¯èƒ½å¼‚å¸¸` |

**ğŸ”¸ æ¸è¿›å¼éƒ¨ç½²å»ºè®®**

```bash
# é˜¶æ®µ1ï¼šä¸´æ—¶æµ‹è¯•é…ç½®å½±å“
firewall-cmd --add-icmp-block=echo-request
# è§‚å¯Ÿä¸šåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œç›‘æ§æ˜¯å¦å¼‚å¸¸

# é˜¶æ®µ2ï¼šç¡®è®¤æ— å½±å“åæ°¸ä¹…ç”Ÿæ•ˆ
firewall-cmd --permanent --add-icmp-block=echo-request
firewall-cmd --reload

# é˜¶æ®µ3ï¼šé€æ­¥åŠ å¼ºå…¶ä»–ICMPé™åˆ¶
# æ¯æ¬¡åªè°ƒæ•´ä¸€ç§ç±»å‹ï¼Œè§‚å¯Ÿå½±å“
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ICMPæœ¬è´¨ï¼šç½‘ç»œå±‚æ§åˆ¶æ¶ˆæ¯åè®®ï¼Œè´Ÿè´£é”™è¯¯æŠ¥å‘Šå’Œç½‘ç»œè¯Šæ–­
ğŸ”¸ å¸¸è§ç±»å‹ï¼šEcho Request/Reply(ping)ï¼ŒDestination Unreachableï¼ŒTime Exceeded
ğŸ”¸ å®‰å…¨æƒè¡¡ï¼šè¯Šæ–­ä»·å€¼ vs ä¿¡æ¯æ³„éœ²é£é™©
ğŸ”¸ è¿‡æ»¤åŸç†ï¼šé€šè¿‡ç±»å‹çº§åˆ«æ§åˆ¶ICMPæ¶ˆæ¯çš„å…è®¸/é˜»æ­¢
ğŸ”¸ å½±å“èŒƒå›´ï¼špingã€tracerouteç­‰ç½‘ç»œè¯Šæ–­å·¥å…·
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ICMPçš„åŒé‡æ€§è´¨**
```
æœ‰ç›Šæ–¹é¢ï¼š
- ç½‘ç»œæ•…éšœè¯Šæ–­çš„åŸºç¡€å·¥å…·
- åº”ç”¨ç¨‹åºé”™è¯¯å¤„ç†çš„ä¾æ®
- ç½‘ç»œè·¯å¾„å‘ç°çš„æ‰‹æ®µ

é£é™©æ–¹é¢ï¼š
- ç½‘ç»œæ¢æµ‹å’Œä¿¡æ¯æ”¶é›†çš„é€”å¾„
- æ‹’ç»æœåŠ¡æ”»å‡»çš„è½½ä½“
- å†…ç½‘ç»“æ„æ³„éœ²çš„æ¸ é“
```

**ğŸ”¹ è¿‡æ»¤ç­–ç•¥çš„å¹³è¡¡åŸåˆ™**
```
å®‰å…¨ä¼˜å…ˆï¼š
é¢å‘å…¬ç½‘çš„æœåŠ¡ â†’ ä¸¥æ ¼é™åˆ¶ICMP
éšè—ç½‘ç»œæ‹“æ‰‘ â†’ é˜»æ­¢æ¢æµ‹ç±»å‹

åŠŸèƒ½ä¿éšœï¼š
å†…ç½‘ç®¡ç†éœ€æ±‚ â†’ é€‚åº¦å¼€æ”¾ICMP
åº”ç”¨æ­£å¸¸è¿è¡Œ â†’ ä¿ç•™é”™è¯¯æŠ¥å‘Šç±»å‹

ç›‘æ§è¯Šæ–­ï¼š
æ•…éšœæ’æŸ¥éœ€æ±‚ â†’ æƒè¡¡å¼€æ”¾å¿…è¦ç±»å‹
è¿ç»´å·¥å…·å…¼å®¹ â†’ è¯„ä¼°å½±å“åè°ƒæ•´
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ”¸ å¸¸ç”¨é…ç½®æ¨¡æ¿**
```bash
# ç”Ÿäº§æœåŠ¡å™¨åŸºç¡€å®‰å…¨é…ç½®
firewall-cmd --permanent --add-icmp-block=echo-request
firewall-cmd --permanent --add-icmp-block=timestamp-request
firewall-cmd --reload

# å†…ç½‘ç®¡ç†æœåŠ¡å™¨é…ç½®
firewall-cmd --zone=internal --permanent --remove-icmp-block=echo-request

# è¾¹ç•Œé˜²ç«å¢™é…ç½®
firewall-cmd --zone=external --permanent --add-icmp-block=echo-request
firewall-cmd --zone=external --permanent --add-icmp-block=router-advertisement
```

**ğŸ”¸ æ•…éšœæ’æŸ¥æ€è·¯**
```
é—®é¢˜ï¼šé…ç½®ICMPè¿‡æ»¤åå‡ºç°å¼‚å¸¸
æ’æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤å…·ä½“ç—‡çŠ¶ï¼ˆpingå¤±è´¥ï¼Ÿåº”ç”¨æŠ¥é”™ï¼Ÿï¼‰
2. æ£€æŸ¥å½“å‰ICMPé…ç½®ï¼šfirewall-cmd --list-icmp-blocks
3. ä¸´æ—¶ç§»é™¤é™åˆ¶æµ‹è¯•ï¼šfirewall-cmd --remove-icmp-block=ç±»å‹
4. ç¡®è®¤é—®é¢˜åŸå› åè°ƒæ•´é…ç½®
```

**ğŸ”¸ æœ€ä½³å®è·µå»ºè®®**
```
é…ç½®åŸåˆ™ï¼š
- å…ˆè¯„ä¼°ä¸šåŠ¡å½±å“ï¼Œå†å®æ–½é™åˆ¶
- åˆ†ç¯å¢ƒå·®å¼‚åŒ–é…ç½®ï¼ˆå†…ç½‘vså…¬ç½‘ï¼‰
- ä¿ç•™å¿…è¦çš„é”™è¯¯æŠ¥å‘Šç±»å‹
- å®šæœŸå®¡æŸ¥å’Œä¼˜åŒ–ICMPç­–ç•¥

ç›‘æ§å»ºè®®ï¼š
- è®°å½•ICMPè¿‡æ»¤æ—¥å¿—
- ç›‘æ§å¼‚å¸¸ICMPæµé‡
- å®šæœŸæ£€æŸ¥é…ç½®æœ‰æ•ˆæ€§
```

### 7.4 å­¦ä¹ è¦ç‚¹è®°å¿†


**ğŸ”¹ æ ¸å¿ƒå‘½ä»¤è®°å¿†**
```bash
æŸ¥çœ‹ï¼šfirewall-cmd --list-icmp-blocks
é˜»æ­¢ï¼šfirewall-cmd --add-icmp-block=ç±»å‹
å…è®¸ï¼šfirewall-cmd --remove-icmp-block=ç±»å‹
æ°¸ä¹…ï¼šåŠ ä¸Š --permanent å‚æ•°
```

**ğŸ”¹ å¸¸è§ICMPç±»å‹è®°å¿†**
- `echo-request` â†’ pingè¯·æ±‚
- `echo-reply` â†’ pingå“åº”  
- `destination-unreachable` â†’ ç›®æ ‡ä¸å¯è¾¾
- `time-exceeded` â†’ è¶…æ—¶ï¼ˆtracerouteç”¨ï¼‰

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ICMPè¿‡æ»¤æ˜¯å®‰å…¨ä¸è¯Šæ–­çš„å¹³è¡¡è‰ºæœ¯
- ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒçš„ICMPç­–ç•¥
- é…ç½®å‰è¦å……åˆ†è¯„ä¼°ä¸šåŠ¡å½±å“
- pingè¢«é˜»æ­¢ä¸å½±å“æœåŠ¡å™¨ä¸»åŠ¨å‘èµ·ç½‘ç»œè¯·æ±‚