---
title: 7、zone基础操作管理
---
## 📚 目录

1. [Zone概念理解](#1-Zone概念理解)
2. [Zone列表查看](#2-Zone列表查看)
3. [Zone详细信息查询](#3-Zone详细信息查询)
4. [Zone创建与删除](#4-Zone创建与删除)
5. [Zone重命名操作](#5-Zone重命名操作)
6. [Zone描述信息设置](#6-Zone描述信息设置)
7. [Zone配置导入导出](#7-Zone配置导入导出)
8. [Zone激活状态管理](#8-Zone激活状态管理)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🔥 Zone概念理解


### 1.1 什么是Zone

**Zone（区域）**就像是**防火墙的分组管理器**，把不同的网络环境分成不同的安全等级。

> 💡 **形象理解**：Zone就像小区的不同管理区域
> - **家庭区域**：家人可以自由进出，信任度最高
> - **办公区域**：同事可以访问，有一定限制
> - **公共区域**：陌生人只能访问特定服务，限制最严

**为什么需要Zone？**
- **环境适配**：家庭WiFi和公司WiFi需要不同的安全策略
- **策略管理**：不同区域应用不同的防火墙规则
- **快速切换**：可以根据网络环境快速切换安全策略

### 1.2 Zone的工作机制


```
网络连接流程：
网络接口 → Zone分配 → 应用规则 → 允许/拒绝连接

示例：
eth0网卡 → public Zone → 只开放22,80端口 → SSH和HTTP可访问
wlan0网卡 → home Zone → 开放更多端口 → 局域网服务可访问
```

### 1.3 默认Zone类型


| Zone名称 | **信任级别** | **典型应用场景** | **默认开放服务** |
|---------|-------------|----------------|-----------------|
| `trusted` | **最高** | `完全信任的网络` | `所有服务` |
| `home` | **高** | `家庭网络` | `SSH, mDNS, DHCP等` |
| `work` | **中高** | `办公网络` | `SSH, DHCP` |
| `public` | **中** | `公共场所WiFi` | `SSH, DHCP` |
| `external` | **低** | `外网连接` | `SSH` |
| `dmz` | **低** | `隔离区服务器` | `SSH` |
| `block` | **最低** | `完全阻断` | `无` |
| `drop` | **最低** | `静默丢弃` | `无` |

---

## 2. 📋 Zone列表查看


### 2.1 查看所有可用Zone


```bash
# 查看系统中所有定义的Zone
firewall-cmd --get-zones

# 输出示例：
# block dmz drop external home internal public trusted work
```

> 📖 **概念说明**：这个命令显示所有**已定义**的Zone，包括系统预设和用户自定义的

### 2.2 查看当前活跃Zone


```bash
# 查看当前正在使用的Zone
firewall-cmd --get-active-zones

# 输出示例：
# public
#   interfaces: eth0
# home  
#   interfaces: wlan0
```

**输出含义解读**：
- `public`：Zone名称
- `interfaces: eth0`：该Zone绑定的网络接口

### 2.3 查看默认Zone


```bash
# 查看系统默认Zone
firewall-cmd --get-default-zone

# 输出示例：public
```

> ⚠️ **重要说明**：新的网络连接如果没有特别指定Zone，会自动使用默认Zone

### 2.4 Zone状态总览


```bash
# 查看完整的Zone状态信息
firewall-cmd --list-all-zones

# 这个命令会显示：
# - 每个Zone的详细配置
# - 绑定的接口
# - 开放的端口和服务
# - 应用的规则
```

**实用技巧**：
- ✅ 用 `--get-zones` 快速查看所有Zone
- ✅ 用 `--get-active-zones` 了解当前网络状态  
- ✅ 用 `--list-all-zones` 进行详细分析

---

## 3. 🔍 Zone详细信息查询


### 3.1 查看指定Zone完整信息


```bash
# 查看public Zone的完整配置
firewall-cmd --zone=public --list-all

# 输出示例：
# public (active)
#   target: default
#   icmp-block-inversion: no
#   interfaces: eth0
#   sources: 
#   services: ssh dhcpv6-client
#   ports: 80/tcp 443/tcp
#   protocols: 
#   masquerade: no
#   forward-ports: 
#   source-ports: 
#   icmp-blocks: 
#   rich rules:
```

**输出字段含义**：

| 字段 | **含义** | **说明** |
|-----|---------|---------|
| `target` | **默认动作** | `default/ACCEPT/REJECT/DROP` |
| `interfaces` | **绑定接口** | `网卡设备名称` |
| `sources` | **源IP范围** | `允许访问的IP段` |
| `services` | **开放服务** | `预定义的服务名` |
| `ports` | **开放端口** | `具体端口号/协议` |
| `masquerade` | **地址伪装** | `NAT功能开关` |

### 3.2 查询Zone的特定配置


```bash
# 查看Zone开放的服务
firewall-cmd --zone=public --list-services

# 查看Zone开放的端口
firewall-cmd --zone=public --list-ports

# 查看Zone绑定的接口
firewall-cmd --zone=public --list-interfaces

# 查看Zone的源地址范围
firewall-cmd --zone=public --list-sources
```

### 3.3 Zone配置层级查询


```
Zone配置查询结构：
├── 基本信息
│   ├── Zone名称和状态
│   ├── 默认动作设置
│   └── ICMP配置
├── 网络绑定
│   ├── 绑定的网络接口
│   └── 源IP地址范围
├── 访问控制
│   ├── 开放的服务列表
│   ├── 开放的端口列表
│   └── 协议配置
└── 高级功能
    ├── 地址伪装设置
    ├── 端口转发规则
    └── 富规则配置
```

> 🔧 **实用建议**：
> - 新手先关注 `services` 和 `ports` 字段
> - 理解 `interfaces` 可以知道Zone作用于哪个网卡
> - `target` 决定了未明确允许的连接如何处理

---

## 4. ➕ Zone创建与删除


### 4.1 创建自定义Zone


```bash
# 创建一个名为myzone的新Zone
firewall-cmd --permanent --new-zone=myzone

# 重新加载配置使新Zone生效
firewall-cmd --reload

# 验证Zone创建成功
firewall-cmd --get-zones
```

**创建Zone的流程**：

```
步骤1: 创建Zone
   ↓
步骤2: 重载配置  
   ↓
步骤3: 配置Zone规则
   ↓
步骤4: 激活使用
```

### 4.2 基于现有Zone创建


```bash
# 基于public Zone创建新Zone
firewall-cmd --permanent --new-zone-from-file=/usr/lib/firewalld/zones/public.xml --name=mycompany
```

> 💡 **技巧说明**：这种方式可以**继承现有Zone的所有配置**，然后再进行个性化修改

### 4.3 删除自定义Zone


```bash
# 删除自定义Zone
firewall-cmd --permanent --delete-zone=myzone

# 重新加载配置
firewall-cmd --reload
```

⚠️ **删除限制**：
- **不能删除**系统预设的Zone（如public、home等）
- **不能删除**正在使用中的Zone
- 删除前需要先**解除所有绑定**

### 4.4 Zone创建最佳实践


**命名规范**：
- ✅ 使用有意义的名称：`company-internal`、`guest-wifi`
- ✅ 避免特殊字符，使用小写字母和连字符
- ❌ 不要使用系统保留名称

**创建流程**：
```
1. 规划Zone用途 → 2. 创建Zone → 3. 配置规则 → 4. 测试验证 → 5. 正式启用
```

---

## 5. 🔄 Zone重命名操作


### 5.1 Zone重命名的实现方式


> ⚠️ **重要说明**：Firewalld**没有直接的重命名命令**，需要通过**复制+删除**的方式实现

```bash
# 方法1：导出配置文件方式重命名
# 步骤1：导出原Zone配置
firewall-cmd --permanent --zone=oldname --list-all > /tmp/zone-config.txt

# 步骤2：创建新Zone
firewall-cmd --permanent --new-zone=newname

# 步骤3：手动配置新Zone（根据导出的配置）
# 步骤4：删除旧Zone
firewall-cmd --permanent --delete-zone=oldname
```

### 5.2 配置文件直接重命名


```bash
# 方法2：直接操作配置文件（需要停止firewalld）
systemctl stop firewalld

# 重命名配置文件
mv /etc/firewalld/zones/oldname.xml /etc/firewalld/zones/newname.xml

# 编辑文件内的zone名称
sed -i 's/oldname/newname/g' /etc/firewalld/zones/newname.xml

# 重启服务
systemctl start firewalld
```

### 5.3 重命名注意事项


**风险提示**：
- 🚨 重命名过程中可能**中断网络连接**
- 🚨 **备份原配置**，避免操作失误
- 🚨 **测试环境**先验证，再应用到生产环境

**推荐流程**：
```
1. 备份当前配置
2. 在新Zone中重建规则  
3. 测试新Zone功能
4. 切换到新Zone
5. 删除旧Zone
```

---

## 6. 📝 Zone描述信息设置


### 6.1 查看Zone描述信息


```bash
# 查看Zone的描述信息
firewall-cmd --zone=public --get-description

# 查看Zone的简短描述
firewall-cmd --zone=public --get-short
```

### 6.2 设置Zone描述


```bash
# 设置Zone的详细描述
firewall-cmd --permanent --zone=myzone --set-description="公司内网专用Zone，允许内部服务访问"

# 设置Zone的简短描述
firewall-cmd --permanent --zone=myzone --set-short="Company Internal"

# 重新加载配置
firewall-cmd --reload
```

### 6.3 描述信息的作用


**实际价值**：
- 📋 **文档化**：说明Zone的用途和适用场景
- 👥 **团队协作**：让其他管理员理解Zone设计意图
- 🔍 **快速识别**：在众多Zone中快速找到目标

**描述规范建议**：
```
好的描述示例：
- short: "Guest WiFi"
- description: "访客WiFi网络，只允许基本网页浏览，禁止内网访问"

避免的描述：
- short: "zone1"  (无意义)
- description: "test" (信息量不足)
```

---

## 7. 📦 Zone配置导入导出


### 7.1 导出Zone配置


```bash
# 方法1：使用firewall-cmd导出
firewall-cmd --permanent --zone=public --list-all > public-zone-backup.txt

# 方法2：直接复制配置文件
cp /etc/firewalld/zones/public.xml /backup/public-zone.xml

# 方法3：导出所有Zone配置
cp -r /etc/firewalld/zones/ /backup/firewalld-zones-$(date +%Y%m%d)
```

### 7.2 导入Zone配置


```bash
# 方法1：基于配置文件创建新Zone
firewall-cmd --permanent --new-zone-from-file=/backup/public-zone.xml --name=restored-public

# 方法2：直接复制配置文件
cp /backup/public-zone.xml /etc/firewalld/zones/
firewall-cmd --reload
```

### 7.3 批量配置管理


```bash
# 创建配置备份脚本
#!/bin/bash
BACKUP_DIR="/backup/firewalld/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# 备份所有Zone配置
cp -r /etc/firewalld/zones/ $BACKUP_DIR/
cp -r /etc/firewalld/services/ $BACKUP_DIR/

# 创建配置说明文件
firewall-cmd --list-all-zones > $BACKUP_DIR/zones-summary.txt
```

### 7.4 配置版本管理


**最佳实践建议**：

| 操作时机 | **备份策略** | **命名规范** |
|---------|-------------|-------------|
| `重大变更前` | **完整备份** | `zones-backup-YYYYMMDD-pre-change` |
| `定期维护` | **增量备份** | `zones-backup-YYYYMMDD-weekly` |
| `系统升级前` | **全量备份** | `zones-backup-YYYYMMDD-upgrade` |

---

## 8. ⚡ Zone激活状态管理


### 8.1 理解Zone激活状态


**Zone激活的含义**：
- 📶 **活跃Zone**：当前正在处理网络流量的Zone
- 💤 **非活跃Zone**：已定义但没有绑定接口或源地址的Zone

```
Zone激活状态图：
┌─────────────┐    ┌──────────────┐
│  网络接口   │───▶│  绑定Zone    │
│   eth0      │    │   public     │
└─────────────┘    └──────────────┘
                           │
                           ▼
                   ┌──────────────┐
                   │   激活状态   │
                   │   (active)   │
                   └──────────────┘
```

### 8.2 Zone与接口绑定管理


```bash
# 将接口绑定到指定Zone
firewall-cmd --zone=home --change-interface=wlan0

# 查看接口当前所属Zone
firewall-cmd --get-zone-of-interface=wlan0

# 从Zone中移除接口
firewall-cmd --zone=home --remove-interface=wlan0
```

### 8.3 Zone与源地址绑定


```bash
# 将源IP地址段绑定到Zone
firewall-cmd --zone=trusted --add-source=192.168.1.0/24

# 查看源地址所属Zone  
firewall-cmd --get-zone-of-source=192.168.1.100

# 从Zone中移除源地址
firewall-cmd --zone=trusted --remove-source=192.168.1.0/24
```

### 8.4 默认Zone管理


```bash
# 设置默认Zone
firewall-cmd --set-default-zone=home

# 查看默认Zone
firewall-cmd --get-default-zone
```

> 💡 **工作机制**：当网络连接**没有明确指定Zone**时，会自动使用默认Zone的规则

### 8.5 Zone激活优先级


**绑定优先级从高到低**：
```
1. 源地址绑定 (--add-source)
   ↓ (如果没有匹配的源地址)
2. 接口绑定 (--change-interface) 
   ↓ (如果接口没有绑定)
3. 默认Zone (--set-default-zone)
```

**实际应用示例**：
```bash
# 配置示例：
# eth0接口 → public Zone
# 192.168.1.0/24 → trusted Zone  
# 默认Zone → home

# 结果：
# 来自192.168.1.x的连接 → 使用trusted Zone规则
# 其他从eth0进入的连接 → 使用public Zone规则  
# 其他连接 → 使用home Zone规则
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的基本概念


```
🔸 Zone本质：网络安全策略的分组管理工具
🔸 Zone状态：活跃Zone处理实际网络流量，非活跃Zone仅为配置
🔸 Zone绑定：通过接口或源地址激活Zone
🔸 默认Zone：未明确绑定连接的兜底策略
🔸 配置持久化：--permanent参数确保重启后配置保留
```

### 9.2 关键操作命令


**🔹 日常查看命令**
```bash
# 快速了解Zone状态
firewall-cmd --get-active-zones        # 查看活跃Zone
firewall-cmd --get-default-zone        # 查看默认Zone
firewall-cmd --zone=public --list-all  # 查看Zone详细配置
```

**🔹 Zone管理命令**
```bash
# Zone创建删除
firewall-cmd --permanent --new-zone=myzone     # 创建Zone
firewall-cmd --permanent --delete-zone=myzone  # 删除Zone

# Zone激活管理  
firewall-cmd --zone=home --change-interface=eth0  # 绑定接口
firewall-cmd --set-default-zone=public            # 设置默认Zone
```

### 9.3 实际应用指导


**🎯 Zone选择策略**
- **家庭环境**：使用 `home` Zone，信任度较高
- **办公环境**：使用 `work` Zone，适度限制
- **公共场所**：使用 `public` Zone，安全性优先
- **服务器环境**：创建自定义Zone，精确控制

**🔧 管理最佳实践**
- ✅ **配置前备份**：避免误操作导致网络中断
- ✅ **逐步测试**：先在测试环境验证配置
- ✅ **文档记录**：为自定义Zone添加描述信息
- ✅ **定期审核**：检查Zone配置是否仍然适用

### 9.4 常见问题与解决


**❓ Zone配置修改后不生效**
```bash
# 解决方案：重新加载配置
firewall-cmd --reload
# 或者重启服务
systemctl restart firewalld
```

**❓ 无法删除Zone**
- **原因**：Zone正在使用中或为系统预设Zone
- **解决**：先解除绑定，再删除非系统Zone

**❓ 网络突然断开**
- **原因**：Zone切换时规则不匹配
- **解决**：使用 `--timeout` 参数测试，自动回滚

**核心记忆要点**：
- Zone是防火墙策略的**分组容器**
- **活跃Zone**才真正影响网络流量
- Zone管理遵循**查看→配置→激活→验证**的流程
- **备份配置**是Zone管理的基本安全措施