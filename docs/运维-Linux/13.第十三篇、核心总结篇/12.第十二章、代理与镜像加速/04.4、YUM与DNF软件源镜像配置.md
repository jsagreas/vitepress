---
title: 4、YUM与DNF软件源镜像配置
---
## 📚 目录

1. [YUM/DNF软件源基础概念](#1-yumdnf软件源基础概念)
2. [软件源配置文件详解](#2-软件源配置文件详解)
3. [CentOS/RHEL官方镜像源配置](#3-centosrhel官方镜像源配置)
4. [EPEL扩展源镜像配置](#4-epel扩展源镜像配置)
5. [yum-config-manager工具使用](#5-yum-config-manager工具使用)
6. [DNF配置文件语法详解](#6-dnf配置文件语法详解)
7. [镜像源优先级与故障转移](#7-镜像源优先级与故障转移)
8. [本地YUM源搭建实战](#8-本地yum源搭建实战)
9. [YUM代理配置参数](#9-yum代理配置参数)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 📦 YUM/DNF软件源基础概念


### 1.1 什么是软件源


**软件源**就像是一个**软件仓库**，存放着各种已经编译好的软件包。就好比手机的应用商店，你想装什么软件就从里面下载安装。

```
传统安装方式：
下载源码 → 解决依赖 → 编译 → 安装 （复杂繁琐）

软件源方式：
yum install 软件名 → 自动下载安装 （简单快捷）
```

**核心优势**：
- 🎯 **自动解决依赖**：不用你操心软件需要什么其他组件
- 🚀 **批量管理**：一条命令更新所有软件
- 🔒 **安全可靠**：经过官方测试的稳定版本
- 🌐 **镜像加速**：选择最近的下载服务器

### 1.2 YUM vs DNF 的区别


**YUM（Yellowdog Updater Modified）**：
- CentOS 7及以下版本的默认包管理器
- 使用Python 2编写
- 功能完善但速度相对较慢

**DNF（Dandified YUM）**：
- CentOS 8+、RHEL 8+、Fedora的新一代包管理器
- 使用Python 3编写，性能更好
- 向下兼容YUM命令，用法几乎相同

```
实际使用体验：
CentOS 7：  yum install nginx    （使用YUM）
CentOS 8：  dnf install nginx    （使用DNF）
         或  yum install nginx    （DNF兼容YUM命令）
```

### 1.3 软件源的工作原理


```
软件安装流程：
用户命令 → 读取配置 → 查询软件源 → 下载软件包 → 安装

详细过程：
┌──────────┐    ┌──────────────┐    ┌──────────────┐
│用户执行  │───→│读取仓库配置   │───→│连接镜像服务器│
│安装命令  │    │/etc/yum.repos.d/│   │查询软件包    │
└──────────┘    └──────────────┘    └──────────────┘
                        │                    │
                        ▼                    ▼
                ┌──────────────┐    ┌──────────────┐
                │检查依赖关系  │◄───│下载软件包    │
                │解决冲突     │    │和依赖包      │
                └──────────────┘    └──────────────┘
                        │
                        ▼
                ┌──────────────┐
                │安装到系统    │
                │更新软件数据库│
                └──────────────┘
```

---

## 2. 📁 软件源配置文件详解


### 2.1 配置文件位置


**主配置目录**：`/etc/yum.repos.d/`

这个目录就像是**软件源的管理中心**，里面每个`.repo`文件都代表一个软件仓库的配置。

```bash
# 查看现有的软件源配置文件
ls -la /etc/yum.repos.d/
```

**典型文件结构**：
```
/etc/yum.repos.d/
├── CentOS-Base.repo         ← 基础软件源
├── CentOS-AppStream.repo    ← 应用程序流
├── CentOS-PowerTools.repo   ← 开发工具
├── epel.repo               ← EPEL扩展源
└── docker-ce.repo          ← 第三方软件源
```

### 2.2 repo文件语法详解


**基本语法结构**：
```ini
[仓库标识名]
name=仓库描述名称
baseurl=软件包下载地址
enabled=是否启用（1启用/0禁用）
gpgcheck=是否检查GPG签名（1检查/0不检查）
gpgkey=GPG公钥文件地址
```

**实际示例解析**：
```ini
[base]
name=CentOS-7 - Base
baseurl=http://mirror.centos.org/centos/7/os/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
enabled=1
```

**字段含义解释**：

| 字段名 | 作用 | 示例值 | 说明 |
|--------|------|--------|------|
| `[base]` | **仓库ID** | `[base]`、`[epel]` | 系统内唯一标识，不能重复 |
| `name` | **显示名称** | `CentOS-7 - Base` | 用户看到的仓库描述 |
| `baseurl` | **下载地址** | `http://mirror.centos.org/...` | 软件包的实际下载链接 |
| `enabled` | **启用状态** | `1`启用 / `0`禁用 | 控制是否使用这个源 |
| `gpgcheck` | **安全验证** | `1`验证 / `0`跳过 | 检查软件包是否被篡改 |
| `gpgkey` | **公钥位置** | `file:///etc/pki/rpm-gpg/...` | 用于验证的密钥文件 |

### 2.3 变量和占位符


**常用变量**：
- `$basearch`：系统架构（如x86_64、i386）
- `$releasever`：系统版本（如7、8）
- `$distro`：发行版名称

**使用示例**：
```ini
baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/
# 在CentOS 7 x86_64系统上自动解析为：
# http://mirror.centos.org/centos/7/os/x86_64/
```

> 💡 **为什么使用变量？**
> 使用变量让配置文件具有通用性，同一个配置文件可以在不同版本、不同架构的系统上使用，不需要手动修改具体的版本号和架构信息。

---

## 3. 🏢 CentOS/RHEL官方镜像源配置


### 3.1 CentOS 7镜像源配置


**官方源特点**：
- 稳定但速度较慢（服务器在国外）
- 软件版本相对保守
- 安全性最高

**配置阿里云镜像源**：

```bash
# 1. 备份原有配置
cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup

# 2. 下载阿里云源配置
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo

# 3. 清理缓存并重建
yum clean all
yum makecache
```

**手动配置示例**：
```ini
# /etc/yum.repos.d/CentOS-Base.repo
[base]
name=CentOS-7 - Base - mirrors.aliyun.com
baseurl=http://mirrors.aliyun.com/centos/7/os/$basearch/
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7

[updates]
name=CentOS-7 - Updates - mirrors.aliyun.com  
baseurl=http://mirrors.aliyun.com/centos/7/updates/$basearch/
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7

[extras]
name=CentOS-7 - Extras - mirrors.aliyun.com
baseurl=http://mirrors.aliyun.com/centos/7/extras/$basearch/
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7
```

### 3.2 CentOS 8/RHEL 8镜像源配置


CentOS 8采用了**模块化仓库**的概念，主要包括：

**仓库类型说明**：
- **BaseOS**：基础操作系统包
- **AppStream**：应用程序流，提供不同版本的软件
- **PowerTools**：开发工具和库文件

**配置清华镜像源**：
```bash
# 备份原配置
sudo cp -r /etc/yum.repos.d/ /etc/yum.repos.d.backup/

# 替换为清华源
sudo sed -i 's|^mirrorlist|#mirrorlist|g' /etc/yum.repos.d/CentOS-*.repo
sudo sed -i 's|^#baseurl=http://mirror.centos.org|baseurl=https://mirrors.tuna.tsinghua.edu.cn|g' /etc/yum.repos.d/CentOS-*.repo

# 更新缓存
sudo dnf makecache
```

### 3.3 常用国内镜像源地址


| 镜像站 | 地址 | 特点 |
|--------|------|------|
| **阿里云** | `http://mirrors.aliyun.com/centos/` | 速度快，稳定性好 |
| **清华大学** | `https://mirrors.tuna.tsinghua.edu.cn/centos/` | 教育网友好 |
| **华为云** | `https://mirrors.huaweicloud.com/centos/` | 企业级稳定 |
| **网易** | `http://mirrors.163.com/centos/` | 老牌镜像站 |
| **腾讯云** | `http://mirrors.cloud.tencent.com/centos/` | 云服务器优化 |

**选择建议**：
- 🏢 **企业环境**：推荐华为云、阿里云
- 🎓 **学校网络**：推荐清华大学镜像
- 🏠 **家庭网络**：根据地理位置选择最近的

---

## 4. 🔧 EPEL扩展源镜像配置


### 4.1 什么是EPEL源


**EPEL**（Extra Packages for Enterprise Linux）是红帽企业版Linux的**额外软件包仓库**。

**为什么需要EPEL**：
```
官方源的限制：
- 软件数量有限（约3000个包）
- 版本相对保守
- 缺少很多常用工具

EPEL源的优势：  
- 软件丰富（约15000个包）
- 包含最新版本
- 兼容性良好
- 由Fedora社区维护
```

**常见EPEL软件**：
- `htop`：增强版系统监控工具
- `nginx`：高性能Web服务器
- `redis`：内存数据库
- `python-pip`：Python包管理器

### 4.2 安装EPEL源


**方法一：官方安装包**
```bash
# CentOS 7
sudo yum install epel-release

# CentOS 8
sudo dnf install epel-release
```

**方法二：手动下载安装**
```bash
# CentOS 7
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
sudo rpm -ivh epel-release-latest-7.noarch.rpm

# CentOS 8  
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
sudo rpm -ivh epel-release-latest-8.noarch.rpm
```

### 4.3 配置EPEL镜像加速


**原理说明**：EPEL默认使用国外服务器，通过配置国内镜像可以大幅提升下载速度。

**配置阿里云EPEL镜像**：
```bash
# 备份原配置
sudo cp /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup

# 替换为阿里云镜像
sudo sed -i 's|^metalink|#metalink|g' /etc/yum.repos.d/epel.repo
sudo sed -i 's|^#baseurl|baseurl|g' /etc/yum.repos.d/epel.repo
sudo sed -i 's|download.fedoraproject.org/pub|mirrors.aliyun.com|g' /etc/yum.repos.d/epel.repo

# 清理缓存
sudo yum clean all && sudo yum makecache
```

**手动配置示例**：
```ini
# /etc/yum.repos.d/epel.repo
[epel]
name=Extra Packages for Enterprise Linux 7 - $basearch
baseurl=http://mirrors.aliyun.com/epel/7/$basearch
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
```

### 4.4 验证EPEL源配置


```bash
# 查看启用的仓库
yum repolist enabled

# 搜索EPEL特有软件
yum search htop

# 安装测试
sudo yum install htop
```

**成功标志**：
- `yum repolist`中显示epel仓库
- 能够搜索到`htop`、`nginx`等EPEL软件
- 安装速度明显提升

---

## 5. ⚙️ yum-config-manager工具使用


### 5.1 工具简介


`yum-config-manager`是YUM的**配置管理工具**，可以通过命令行方式管理软件源，而不需要手动编辑配置文件。

**安装工具**：
```bash
# CentOS 7
sudo yum install yum-utils

# CentOS 8
sudo dnf install dnf-utils
```

### 5.2 基本操作命令


**查看所有仓库**：
```bash
# 查看所有仓库（包括禁用的）
yum-config-manager --dump

# 只查看启用的仓库  
yum repolist enabled

# 只查看禁用的仓库
yum repolist disabled
```

**启用/禁用仓库**：
```bash
# 启用仓库
sudo yum-config-manager --enable epel

# 禁用仓库
sudo yum-config-manager --disable epel

# 同时操作多个仓库
sudo yum-config-manager --enable base updates extras
```

### 5.3 添加第三方软件源


**添加Docker官方源**：
```bash
# 添加Docker CE仓库
sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo

# 验证添加成功
yum repolist | grep docker
```

**添加Nginx官方源**：
```bash
# 创建Nginx仓库配置
sudo yum-config-manager --add-repo http://nginx.org/packages/centos/7/x86_64/

# 导入GPG密钥
sudo rpm --import http://nginx.org/keys/nginx_signing.key
```

### 5.4 修改仓库属性


**设置仓库优先级**：
```bash
# 设置base仓库优先级为1（最高）
sudo yum-config-manager --setopt="base.priority=1" --save

# 设置EPEL仓库优先级为10
sudo yum-config-manager --setopt="epel.priority=10" --save
```

**临时禁用GPG检查**：
```bash
# 临时禁用特定仓库的GPG检查
sudo yum-config-manager --setopt="epel.gpgcheck=0" --save
```

**实用技巧**：

> 💡 **批量管理技巧**
> ```bash
> # 一次性禁用所有第三方源
> sudo yum-config-manager --disable "*" --enable base updates extras
> 
> # 临时启用仓库安装软件
> sudo yum --enablerepo=epel install htop
> ```

---

## 6. 🔧 DNF配置文件语法详解


### 6.1 DNF主配置文件


**位置**：`/etc/dnf/dnf.conf`

**基本结构**：
```ini
[main]
gpgcheck=1
installonly_limit=3
clean_requirements_on_remove=True
best=False
skip_if_unavailable=True
```

**重要参数解释**：

| 参数 | 含义 | 推荐值 | 说明 |
|------|------|--------|------|
| `gpgcheck` | GPG签名验证 | `1` | 1=启用，0=禁用，建议启用保证安全 |
| `installonly_limit` | 保留内核数量 | `3` | 避免内核更新占用过多磁盘空间 |
| `clean_requirements_on_remove` | 移除依赖 | `True` | 卸载软件时自动清理无用依赖 |
| `best` | 选择最佳版本 | `False` | True时严格选择最新版，可能导致依赖冲突 |
| `skip_if_unavailable` | 跳过不可用源 | `True` | 某个源无法访问时继续使用其他源 |

### 6.2 DNF仓库配置


DNF的仓库配置文件与YUM完全兼容，位于`/etc/yum.repos.d/`目录。

**DNF特有参数**：
```ini
[epel]
name=EPEL Repository
baseurl=http://mirrors.aliyun.com/epel/8/$basearch
enabled=1
gpgcheck=1
countme=1
metadata_expire=7d
repo_gpgcheck=0
type=rpm
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8
skip_if_unavailable=True
```

**DNF扩展参数说明**：

- `countme=1`：向仓库报告使用统计（可选）
- `metadata_expire=7d`：元数据缓存7天后过期
- `repo_gpgcheck=0`：不检查仓库元数据的GPG签名
- `type=rpm`：指定仓库类型为RPM包

### 6.3 模块化仓库配置


CentOS 8引入了**模块化仓库**概念，允许同时提供软件的多个版本。

**模块化概念**：
```
传统方式：一个软件只有一个版本
模块化：一个软件可以有多个版本流（Stream）

例如：
- nodejs:10  (Node.js 10.x版本)
- nodejs:12  (Node.js 12.x版本) 
- nodejs:14  (Node.js 14.x版本)
```

**模块化操作命令**：
```bash
# 查看可用模块
dnf module list

# 查看nodejs模块的不同版本
dnf module list nodejs

# 安装特定版本的nodejs
dnf module install nodejs:14

# 切换nodejs版本
dnf module reset nodejs
dnf module install nodejs:12
```

---

## 7. ⚖️ 镜像源优先级与故障转移


### 7.1 优先级机制原理


**优先级数字含义**：
- 数字**越小**优先级**越高**
- 默认优先级为99
- 优先级1为最高，99为最低

```
优先级示例：
base仓库     → priority=1  （最高优先级）
updates仓库  → priority=5  
epel仓库     → priority=10
第三方仓库   → priority=20 （较低优先级）
```

**工作原理**：
```
软件包查找顺序：
1. 检查priority=1的仓库
2. 找到软件包则直接使用
3. 找不到才检查priority=5的仓库
4. 以此类推...

好处：确保关键软件来源的可控性
```

### 7.2 配置优先级


**安装priorities插件**：
```bash
# CentOS 7需要安装插件
sudo yum install yum-plugin-priorities

# CentOS 8 DNF原生支持
```

**设置仓库优先级**：
```ini
# /etc/yum.repos.d/CentOS-Base.repo
[base]
name=CentOS-7 - Base
baseurl=http://mirrors.aliyun.com/centos/7/os/$basearch/
priority=1
enabled=1
gpgcheck=1

[updates]  
name=CentOS-7 - Updates
baseurl=http://mirrors.aliyun.com/centos/7/updates/$basearch/
priority=1
enabled=1
gpgcheck=1

# /etc/yum.repos.d/epel.repo
[epel]
name=EPEL Repository
baseurl=http://mirrors.aliyun.com/epel/7/$basearch/
priority=10
enabled=1
gpgcheck=1
```

### 7.3 故障转移配置


**多镜像源配置**：
```ini
[base]
name=CentOS-7 - Base
# 主镜像源
baseurl=http://mirrors.aliyun.com/centos/7/os/$basearch/
# 备用镜像源
        http://mirrors.tuna.tsinghua.edu.cn/centos/7/os/$basearch/
        http://mirrors.163.com/centos/7/os/$basearch/
enabled=1
gpgcheck=1
# 设置故障转移参数
failovermethod=priority
timeout=10
retries=3
```

**故障转移参数说明**：
- `failovermethod=priority`：按顺序尝试镜像源
- `timeout=10`：连接超时10秒
- `retries=3`：失败后重试3次

### 7.4 测试优先级配置


```bash
# 查看仓库优先级
yum repolist -v

# 测试软件包来源
yum info nginx

# 模拟安装查看选择过程
yum install --downloadonly --downloaddir=/tmp nginx
```

**验证优先级生效**：
```bash
# 安装不同仓库的同名软件包测试
yum list available | grep nginx
# 应该显示来自高优先级仓库的版本
```

---

## 8. 💾 本地YUM源搭建实战


### 8.1 为什么需要本地YUM源


**使用场景**：
- 🏢 **内网环境**：无法访问互联网的服务器
- 🚀 **批量部署**：减少重复下载，提高部署速度  
- 💰 **带宽节省**：避免多台服务器重复下载
- 🔒 **安全管控**：统一管理软件包版本

**架构示意**：
```
内网服务器群
┌─────────┐    ┌─────────┐    ┌─────────┐
│ Server1 │    │ Server2 │    │ Server3 │
└─────────┘    └─────────┘    └─────────┘
     │              │              │
     └──────────────┼──────────────┘
                    │
              ┌─────────────┐
              │ 本地YUM源   │ ←── HTTP/FTP服务
              │ (内网服务器) │
              └─────────────┘
                    │
              ┌─────────────┐
              │   互联网     │ ←── 定期同步软件包
              └─────────────┘
```

### 8.2 本地YUM源搭建步骤


**环境准备**：
- 一台Linux服务器作为YUM源服务器
- 足够的磁盘空间（建议至少50GB）
- 安装HTTP服务器（如Apache或Nginx）

**第一步：安装必要软件**
```bash
# 安装HTTP服务器和同步工具
sudo yum install httpd createrepo rsync wget

# 启动HTTP服务
sudo systemctl start httpd
sudo systemctl enable httpd
```

**第二步：创建仓库目录**
```bash
# 创建仓库根目录
sudo mkdir -p /var/www/html/centos/7/{os,updates,extras}

# 设置目录权限
sudo chown -R apache:apache /var/www/html/centos
```

**第三步：同步软件包**
```bash
# 同步CentOS base仓库（约10GB）
sudo rsync -avz --delete rsync://mirrors.aliyun.com/centos/7/os/x86_64/ \
    /var/www/html/centos/7/os/

# 同步updates仓库（约2GB）  
sudo rsync -avz --delete rsync://mirrors.aliyun.com/centos/7/updates/x86_64/ \
    /var/www/html/centos/7/updates/
```

### 8.3 创建仓库元数据


**生成仓库元数据**：
```bash
# 为每个仓库创建元数据
sudo createrepo /var/www/html/centos/7/os/
sudo createrepo /var/www/html/centos/7/updates/

# 更新现有仓库元数据
sudo createrepo --update /var/www/html/centos/7/os/
```

**验证仓库结构**：
```bash
# 检查目录结构
ls -la /var/www/html/centos/7/os/
# 应该看到repodata目录（包含元数据）

# 测试HTTP访问
curl -I http://localhost/centos/7/os/repodata/repomd.xml
# 应该返回200 OK
```

### 8.4 客户端配置


**创建本地源配置**：
```bash
# 备份原配置
sudo cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup

# 创建本地源配置
sudo cat > /etc/yum.repos.d/local.repo << EOF
[local-base]
name=Local CentOS-7 Base
baseurl=http://192.168.1.100/centos/7/os/
enabled=1
gpgcheck=0

[local-updates]
name=Local CentOS-7 Updates  
baseurl=http://192.168.1.100/centos/7/updates/
enabled=1
gpgcheck=0
EOF

# 禁用原有网络源
sudo yum-config-manager --disable base updates extras

# 清理缓存
sudo yum clean all && sudo yum makecache
```

### 8.5 自动化同步脚本


**创建同步脚本**：
```bash
#!/bin/bash
# /usr/local/bin/sync-yum-repo.sh

REPO_ROOT="/var/www/html/centos/7"
LOG_FILE="/var/log/yum-sync.log"

echo "$(date): 开始同步YUM仓库" >> $LOG_FILE

# 同步base仓库
rsync -avz --delete rsync://mirrors.aliyun.com/centos/7/os/x86_64/ \
    $REPO_ROOT/os/ >> $LOG_FILE 2>&1

# 同步updates仓库  
rsync -avz --delete rsync://mirrors.aliyun.com/centos/7/updates/x86_64/ \
    $REPO_ROOT/updates/ >> $LOG_FILE 2>&1

# 更新仓库元数据
createrepo --update $REPO_ROOT/os/ >> $LOG_FILE 2>&1
createrepo --update $REPO_ROOT/updates/ >> $LOG_FILE 2>&1

echo "$(date): YUM仓库同步完成" >> $LOG_FILE
```

**设置定时任务**：
```bash
# 给脚本执行权限
sudo chmod +x /usr/local/bin/sync-yum-repo.sh

# 添加到定时任务（每天凌晨2点执行）
sudo crontab -e
0 2 * * * /usr/local/bin/sync-yum-repo.sh
```

---

## 9. 🌐 YUM代理配置参数


### 9.1 代理配置需求场景


**企业网络环境**：
```
内网服务器 → 企业代理服务器 → 互联网 → YUM仓库

问题：内网服务器无法直接访问外网的YUM仓库
解决：配置YUM使用企业代理服务器
```

**常见代理类型**：
- **HTTP代理**：普通的Web代理
- **HTTPS代理**：支持HTTPS的代理
- **SOCKS代理**：支持SOCKS协议的代理
- **认证代理**：需要用户名密码的代理

### 9.2 全局代理配置


**在主配置文件中设置**：
```bash
sudo vim /etc/yum.conf
```

**添加代理配置**：
```ini
[main]
cachedir=/var/cache/yum/$basearch/$releasever
keepcache=0
debuglevel=2
logfile=/var/log/yum.log
# 代理服务器地址
proxy=http://proxy.company.com:8080
# 代理用户认证（如果需要）
proxy_username=your_username
proxy_password=your_password
# 不使用代理的地址（内网地址）
proxy_auth_method=basic
```

**参数详细说明**：

| 参数 | 说明 | 示例值 |
|------|------|--------|
| `proxy` | 代理服务器地址 | `http://proxy.company.com:8080` |
| `proxy_username` | 代理认证用户名 | `username` |
| `proxy_password` | 代理认证密码 | `password` |
| `proxy_auth_method` | 认证方法 | `basic`、`digest`、`ntlm` |

### 9.3 环境变量方式配置


**设置环境变量**：
```bash
# 临时设置（当前会话有效）
export http_proxy=http://proxy.company.com:8080
export https_proxy=http://proxy.company.com:8080
export ftp_proxy=http://proxy.company.com:8080

# 设置不走代理的地址
export no_proxy=localhost,127.0.0.1,192.168.0.0/16,10.0.0.0/8

# 执行yum命令
sudo -E yum update
```

**永久设置环境变量**：
```bash
# 添加到系统环境变量
sudo vim /etc/environment

# 添加以下内容：
http_proxy=http://proxy.company.com:8080
https_proxy=http://proxy.company.com:8080
no_proxy=localhost,127.0.0.1,192.168.0.0/16
```

### 9.4 特定仓库代理配置


**为单个仓库设置代理**：
```ini
# /etc/yum.repos.d/epel.repo
[epel]
name=Extra Packages for Enterprise Linux 7
baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch
enabled=1
gpgcheck=1
# 仅此仓库使用代理
proxy=http://special-proxy.company.com:8080
proxy_username=special_user
proxy_password=special_pass
```

**不同仓库不同代理**：
```ini
# 内网仓库不使用代理
[internal]
name=Internal Repository
baseurl=http://internal.company.com/repo/
proxy=_none_

# 外网仓库使用代理
[external]  
name=External Repository
baseurl=http://external-repo.com/
proxy=http://proxy.company.com:8080
```

### 9.5 代理配置验证


**测试代理连接**：
```bash
# 测试代理服务器连接
curl -x http://proxy.company.com:8080 http://www.baidu.com

# 测试YUM是否能通过代理工作
yum --enablerepo=epel search htop

# 查看YUM使用的代理设置
yum-config-manager --dump | grep proxy
```

**调试代理问题**：
```bash
# 启用详细日志
yum -v update

# 查看YUM日志
tail -f /var/log/yum.log

# 测试特定仓库
yum --enablerepo=epel --disablerepo="*" list available
```

**常见代理配置问题**：

> ⚠️ **注意事项**
> 
> **密码安全问题**：代理密码明文存储在配置文件中，需要注意文件权限：
> ```bash
> sudo chmod 600 /etc/yum.conf
> ```
> 
> **内网地址排除**：确保内网仓库不走代理：
> ```ini
> proxy=http://proxy.company.com:8080
> proxy_auth_method=basic
> # 内网仓库添加以下行
> proxy=_none_
> ```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心概念


```
🔸 软件源本质：就像应用商店，存放编译好的软件包
🔸 配置文件位置：/etc/yum.repos.d/*.repo文件
🔸 EPEL源重要性：大大扩充可用软件数量，必装扩展源  
🔸 镜像源选择：国内镜像源能显著提升下载速度
🔸 优先级机制：数字越小优先级越高，控制软件包来源
🔸 本地源应用：内网环境和批量部署的最佳选择
🔸 代理配置：企业网络环境的必备技能
```

### 10.2 关键实操技能


**🔹 快速配置技巧**
```bash
# 一键备份现有配置
cp /etc/yum.repos.d/CentOS-Base.repo{,.backup}

# 一键配置阿里云镜像源
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo

# 一键安装EPEL并配置国内镜像
yum install -y epel-release
sed -i 's|^metalink|#metalink|g' /etc/yum.repos.d/epel.repo
sed -i 's|^#baseurl|baseurl|g' /etc/yum.repos.d/epel.repo
sed -i 's|download.fedoraproject.org/pub|mirrors.aliyun.com|g' /etc/yum.repos.d/epel.repo

# 清理缓存并重建
yum clean all && yum makecache
```

**🔹 故障排查思路**
```
软件包安装失败排查步骤：
1. yum repolist enabled    # 检查仓库状态
2. yum clean all          # 清理缓存
3. yum makecache          # 重建缓存  
4. yum search 软件名       # 确认软件包存在
5. yum install -y 软件名   # 尝试安装

网络问题排查：
1. ping 镜像源服务器      # 测试网络连通性
2. curl 仓库地址         # 测试HTTP访问
3. 检查代理配置          # 企业网络必查项
```

### 10.3 最佳实践建议


**📝 日常维护建议**
```
配置管理：
✅ 定期备份仓库配置文件
✅ 使用版本控制管理配置变更  
✅ 为不同环境准备不同的配置

性能优化：
✅ 选择地理位置最近的镜像源
✅ 合理设置仓库优先级
✅ 定期清理YUM缓存释放空间

安全考虑：
✅ 启用GPG签名验证（gpgcheck=1）
✅ 只启用必需的仓库
✅ 代理密码文件权限控制
```

**🎯 不同场景的配置策略**

| 使用场景 | 推荐配置 | 注意要点 |
|---------|---------|---------|
| **个人学习** | 阿里云/清华镜像 + EPEL | 追求速度，软件丰富 |
| **企业生产** | 官方源 + 本地镜像 + 优先级控制 | 稳定性第一，可控性强 |
| **内网环境** | 本地YUM源 + 定时同步 | 完全离线，自主可控 |
| **开发测试** | 多镜像源 + 第三方源 | 软件版本新，选择多样 |

**核心记忆口诀**：
- 软件源像商店，配置文件是钥匙
- 国内镜像速度快，EPEL扩展不可少  
- 优先级小为最高，代理配置解网桥
- 本地源建内网好，定时同步不能少
- 备份配置很重要，排查问题有章法