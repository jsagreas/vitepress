---
title: 9ã€IPv6åŸºç¡€é…ç½®ä¸åŒæ ˆ
---
## ğŸ“š ç›®å½•

1. [IPv6åœ°å€æ ¼å¼ä¸åˆ†ç±»](#1-IPv6åœ°å€æ ¼å¼ä¸åˆ†ç±»)
2. [IPv6åœ°å€è‡ªåŠ¨é…ç½®æœºåˆ¶](#2-IPv6åœ°å€è‡ªåŠ¨é…ç½®æœºåˆ¶)
3. [IPv6é™æ€åœ°å€é…ç½®](#3-IPv6é™æ€åœ°å€é…ç½®)
4. [IPv4/IPv6åŒæ ˆç¯å¢ƒé…ç½®](#4-IPv4IPv6åŒæ ˆç¯å¢ƒé…ç½®)
5. [IPv6é‚»å±…å‘ç°åè®®](#5-IPv6é‚»å±…å‘ç°åè®®)
6. [IPv6è·¯ç”±é…ç½®ä¸ç®¡ç†](#6-IPv6è·¯ç”±é…ç½®ä¸ç®¡ç†)
7. [IPv6 DNSé…ç½®](#7-IPv6-DNSé…ç½®)
8. [IPv6è¿é€šæ€§æµ‹è¯•](#8-IPv6è¿é€šæ€§æµ‹è¯•)
9. [IPv6ä¸IPv4éš§é“æŠ€æœ¯](#9-IPv6ä¸IPv4éš§é“æŠ€æœ¯)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ IPv6åœ°å€æ ¼å¼ä¸åˆ†ç±»


### 1.1 IPv6åœ°å€åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯IPv6ï¼Ÿ**
> IPv6å°±åƒç»™äº’è”ç½‘æ¢äº†ä¸€å¥—"æ–°é—¨ç‰Œå·ç³»ç»Ÿ"ã€‚å¦‚æœè¯´IPv4çš„åœ°å€åƒç”µè¯å·ç ï¼ˆåªæœ‰10ä½æ•°å­—ï¼‰ï¼Œé‚£IPv6å°±åƒèº«ä»½è¯å·ç ï¼ˆ18ä½æ•°å­—+å­—æ¯ï¼‰ï¼Œèƒ½æä¾›æ›´å¤šçš„åœ°å€ç©ºé—´ã€‚

**åœ°å€é•¿åº¦å¯¹æ¯”ï¼š**
```
IPv4åœ°å€é•¿åº¦ï¼š32ä½ = 4å­—èŠ‚
å¯ç”¨åœ°å€æ•°é‡ï¼šçº¦43äº¿ä¸ª
ç¤ºä¾‹ï¼š192.168.1.1

IPv6åœ°å€é•¿åº¦ï¼š128ä½ = 16å­—èŠ‚  
å¯ç”¨åœ°å€æ•°é‡ï¼šçº¦3.4Ã—10Â³â¸ä¸ª
ç¤ºä¾‹ï¼š2001:0db8:85a3:0000:0000:8a2e:0370:7334
```

### 1.2 IPv6åœ°å€è¡¨ç¤ºæ ¼å¼


#### ğŸ”¸ å®Œæ•´æ ¼å¼

IPv6åœ°å€ç”±8ç»„16è¿›åˆ¶æ•°å­—ç»„æˆï¼Œæ¯ç»„4ä½ï¼Œç”¨å†’å·åˆ†éš”ï¼š
```
å®Œæ•´æ ¼å¼ï¼š2001:0db8:85a3:0000:0000:8a2e:0370:7334
æ ¼å¼è¯´æ˜ï¼šxxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx
æ¯ä¸ªxï¼šä»£è¡¨ä¸€ä¸ª16è¿›åˆ¶æ•°å­—ï¼ˆ0-9, a-fï¼‰
æ¯ç»„ï¼š4ä¸ª16è¿›åˆ¶æ•°å­— = 16ä½ = 2å­—èŠ‚
æ€»å…±ï¼š8ç»„ Ã— 16ä½ = 128ä½
```

#### ğŸ”¸ ç®€åŒ–è¡¨ç¤ºè§„åˆ™


**è§„åˆ™1ï¼šçœç•¥å‰å¯¼é›¶**
```
åŸå§‹åœ°å€ï¼š2001:0db8:0000:0042:0000:8a2e:0370:7334
ç®€åŒ–åï¼š 2001:db8:0:42:0:8a2e:370:7334
è¯´æ˜ï¼šæ¯ç»„å¼€å¤´çš„0å¯ä»¥çœç•¥ï¼Œä½†æ¯ç»„è‡³å°‘ä¿ç•™ä¸€ä¸ªæ•°å­—
```

**è§„åˆ™2ï¼šè¿ç»­é›¶çš„å‹ç¼©**
```
åŸå§‹åœ°å€ï¼š2001:0db8:0000:0000:0000:0000:0000:7334
ç®€åŒ–åï¼š 2001:db8::7334
è¯´æ˜ï¼šè¿ç»­çš„å…¨é›¶ç»„ç”¨::è¡¨ç¤ºï¼Œä½†åœ¨ä¸€ä¸ªåœ°å€ä¸­::åªèƒ½ä½¿ç”¨ä¸€æ¬¡
```

**è§„åˆ™3ï¼šç‰¹æ®Šæƒ…å†µ**
```
å…¨é›¶åœ°å€ï¼š0000:0000:0000:0000:0000:0000:0000:0000
ç®€åŒ–ä¸ºï¼š  ::

å›ç¯åœ°å€ï¼š0000:0000:0000:0000:0000:0000:0000:0001  
ç®€åŒ–ä¸ºï¼š  ::1
```

### 1.3 IPv6åœ°å€åˆ†ç±»è¯¦è§£


#### ğŸ”¸ å•æ’­åœ°å€ï¼ˆUnicastï¼‰

> å•æ’­å°±åƒ"å¯„ä¿¡ç»™ä¸€ä¸ªç‰¹å®šçš„äºº"ï¼Œä¸€å¯¹ä¸€é€šä¿¡

| **åœ°å€ç±»å‹** | **åœ°å€å‰ç¼€** | **ç”¨é€”è¯´æ˜** | **ç¤ºä¾‹** |
|------------|-------------|-------------|----------|
| **å…¨çƒå•æ’­** | `2000::/3` | å…¬ç½‘é€šä¿¡ï¼Œç›¸å½“äºIPv4å…¬ç½‘åœ°å€ | `2001:db8::/32` |
| **é“¾è·¯æœ¬åœ°** | `fe80::/10` | æœ¬åœ°é“¾è·¯é€šä¿¡ï¼Œç›¸å½“äº169.254.x.x | `fe80::1` |
| **å”¯ä¸€æœ¬åœ°** | `fc00::/7` | ç§ç½‘é€šä¿¡ï¼Œç›¸å½“äº192.168.x.x | `fd00::/8` |
| **å›ç¯åœ°å€** | `::1/128` | æœ¬æœºé€šä¿¡ï¼Œç›¸å½“äº127.0.0.1 | `::1` |

#### ğŸ”¸ ç»„æ’­åœ°å€ï¼ˆMulticastï¼‰

> ç»„æ’­åƒ"ç»™ä¸€ç¾¤äººå‘é€šçŸ¥"ï¼Œä¸€å¯¹å¤šé€šä¿¡

```
ç»„æ’­åœ°å€å‰ç¼€ï¼šff00::/8

å¸¸ç”¨ç»„æ’­åœ°å€ï¼š
ff02::1   â† æ‰€æœ‰èŠ‚ç‚¹ç»„æ’­ï¼ˆæœ¬åœ°é“¾è·¯ï¼‰
ff02::2   â† æ‰€æœ‰è·¯ç”±å™¨ç»„æ’­ï¼ˆæœ¬åœ°é“¾è·¯ï¼‰  
ff02::1:2 â† DHCPv6æœåŠ¡å™¨/ä»£ç†ç»„æ’­
ff05::2   â† æ‰€æœ‰è·¯ç”±å™¨ç»„æ’­ï¼ˆç«™ç‚¹æœ¬åœ°ï¼‰
```

#### ğŸ”¸ ä»»æ’­åœ°å€ï¼ˆAnycastï¼‰

> ä»»æ’­åƒ"å¯„ä¿¡ç»™æœ€è¿‘çš„é‚®å±€"ï¼Œå‘é€ç»™ä¸€ç»„åœ°å€ä¸­è·ç¦»æœ€è¿‘çš„é‚£ä¸ª

```
ä»»æ’­åœ°å€ç‰¹ç‚¹ï¼š
â€¢ è¯­æ³•ä¸Šä¸å•æ’­åœ°å€ç›¸åŒ
â€¢ åˆ†é…ç»™å¤šä¸ªæ¥å£ï¼Œä½†æ•°æ®åŒ…åªå‘ç»™æœ€è¿‘çš„ä¸€ä¸ª
â€¢ å¸¸ç”¨äºè´Ÿè½½å‡è¡¡å’Œå†—ä½™è®¾è®¡
â€¢ ä¾‹ï¼šDNSæ ¹æœåŠ¡å™¨ä½¿ç”¨ä»»æ’­æŠ€æœ¯
```

### 1.4 åœ°å€ç»“æ„åˆ†æ


#### ğŸ”¸ å…¨çƒå•æ’­åœ°å€ç»“æ„

```
å…¨çƒå•æ’­åœ°å€ï¼š2001:0db8:1234:5678:abcd:ef01:2345:6789
ç»“æ„åˆ’åˆ†ï¼š

â”Œâ”€ å…¨çƒè·¯ç”±å‰ç¼€ â”€â”â”Œå­ç½‘IDâ”â”Œâ”€â”€â”€ æ¥å£æ ‡è¯†ç¬¦ â”€â”€â”€â”€â”
  2001:0db8:1234   :5678  :abcd:ef01:2345:6789
  |               |      |
  48ä½            16ä½   64ä½
  ISPåˆ†é…         å­ç½‘   ä¸»æœºæ ‡è¯†
```

**å„éƒ¨åˆ†å«ä¹‰ï¼š**
- **å…¨çƒè·¯ç”±å‰ç¼€**ï¼ˆ48ä½ï¼‰ï¼šISPåˆ†é…çš„ç½‘ç»œæ ‡è¯†ï¼Œç±»ä¼¼IPv4çš„ç½‘ç»œéƒ¨åˆ†
- **å­ç½‘ID**ï¼ˆ16ä½ï¼‰ï¼šç»„ç»‡å†…éƒ¨å­ç½‘åˆ’åˆ†ï¼Œå¯åˆ›å»º65536ä¸ªå­ç½‘
- **æ¥å£æ ‡è¯†ç¬¦**ï¼ˆ64ä½ï¼‰ï¼šä¸»æœºæ ‡è¯†ï¼Œé€šå¸¸é€šè¿‡MACåœ°å€ç”Ÿæˆ

#### ğŸ”¸ é“¾è·¯æœ¬åœ°åœ°å€ç»“æ„

```
é“¾è·¯æœ¬åœ°åœ°å€ï¼šfe80::abcd:ef01:2345:6789
ç»“æ„åˆ’åˆ†ï¼š

â”Œå‰ç¼€â”€â”â”Œâ”€å…¨é›¶â”€â”â”Œâ”€â”€â”€ æ¥å£æ ‡è¯†ç¬¦ â”€â”€â”€â”€â”
  fe80   :0000  :abcd:ef01:2345:6789
  |      |      |
  10ä½   54ä½   64ä½
  å›ºå®š   é¢„ç•™   ä¸»æœºæ ‡è¯†
```

### 1.5 å®é™…é…ç½®ç¤ºä¾‹


**ç½‘ç»œè§„åˆ’ç¤ºä¾‹ï¼š**
```
ä¼ä¸šç½‘ç»œIPv6è§„åˆ’ï¼š

åˆ†é…çš„å‰ç¼€ï¼š2001:db8:1000::/48
å­ç½‘åˆ’åˆ†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å­ç½‘ç”¨é€”   â”‚    å­ç½‘å‰ç¼€     â”‚   å¯ç”¨ä¸»æœºæ•°   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç®¡ç†ç½‘ç»œ    â”‚ 2001:db8:1000:1::/64 â”‚ 2â¶â´ä¸ª      â”‚
â”‚  æœåŠ¡å™¨ç½‘ç»œ  â”‚ 2001:db8:1000:2::/64 â”‚ 2â¶â´ä¸ª      â”‚  
â”‚  ç”¨æˆ·ç½‘ç»œ1   â”‚ 2001:db8:1000:10::/64â”‚ 2â¶â´ä¸ª      â”‚
â”‚  ç”¨æˆ·ç½‘ç»œ2   â”‚ 2001:db8:1000:20::/64â”‚ 2â¶â´ä¸ª      â”‚
â”‚  DMZç½‘ç»œ     â”‚ 2001:db8:1000:f0::/64â”‚ 2â¶â´ä¸ª      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœ°å€åˆ†é…ç­–ç•¥ï¼š**
```
æœåŠ¡å™¨åœ°å€åˆ†é…ï¼š
WebæœåŠ¡å™¨ï¼š  2001:db8:1000:2::10
DNSæœåŠ¡å™¨ï¼š  2001:db8:1000:2::53  
é‚®ä»¶æœåŠ¡å™¨ï¼š 2001:db8:1000:2::25
æ•°æ®åº“ï¼š     2001:db8:1000:2::100

ç”¨æˆ·è®¾å¤‡ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰ï¼š
å‰ç¼€ï¼š2001:db8:1000:10::/64
æ¥å£IDï¼šæ ¹æ®MACåœ°å€è‡ªåŠ¨ç”Ÿæˆ
å®Œæ•´åœ°å€ï¼š2001:db8:1000:10:xxxx:xxxx:xxxx:xxxx
```

---

## 2. âš™ï¸ IPv6åœ°å€è‡ªåŠ¨é…ç½®æœºåˆ¶


### 2.1 SLAACåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯SLAACï¼Ÿ**
> SLAACï¼ˆStateless Address Auto-Configurationï¼‰å°±åƒ"æ™ºèƒ½é—¨ç‰Œå·åˆ†é…ç³»ç»Ÿ"ï¼Œè®¾å¤‡æ’ç½‘çº¿å°±èƒ½è‡ªåŠ¨è·å¾—æ­£ç¡®çš„åœ°å€ï¼Œä¸éœ€è¦ç®¡ç†å‘˜æ‰‹åŠ¨é…ç½®ã€‚

```
è‡ªåŠ¨é…ç½®è¿‡ç¨‹å¯¹æ¯”ï¼š

IPv4 DHCPè¿‡ç¨‹ï¼š
è®¾å¤‡ä¸Šçº¿ â†’ å¹¿æ’­DHCPè¯·æ±‚ â†’ æœåŠ¡å™¨åˆ†é…IP â†’ è®¾å¤‡ä½¿ç”¨IP
éœ€è¦ï¼šDHCPæœåŠ¡å™¨ã€åœ°å€æ± ç®¡ç†ã€ç§Ÿçº¦ç®¡ç†

IPv6 SLAACè¿‡ç¨‹ï¼š  
è®¾å¤‡ä¸Šçº¿ â†’ ç”Ÿæˆé“¾è·¯æœ¬åœ°åœ°å€ â†’ è¯·æ±‚è·¯ç”±å™¨ä¿¡æ¯ â†’ è‡ªåŠ¨é…ç½®å…¨çƒåœ°å€
éœ€è¦ï¼šè·¯ç”±å™¨æ”¯æŒRAï¼ˆè·¯ç”±é€šå‘Šï¼‰
```

### 2.2 SLAACå·¥ä½œåŸç†è¯¦è§£


#### ğŸ”¸ ç¬¬ä¸€æ­¥ï¼šé“¾è·¯æœ¬åœ°åœ°å€ç”Ÿæˆ

```
ç”Ÿæˆè¿‡ç¨‹ï¼š
1. è®¾å¤‡å¼€æœºï¼Œç½‘å¡è·å–MACåœ°å€
   MACåœ°å€ï¼š00:1B:63:84:45:E6

2. è½¬æ¢ä¸ºEUI-64æ ¼å¼ï¼š
   MAC: 00:1B:63 | 84:45:E6
   æ’å…¥fffe: 00:1B:63:FF:FE:84:45:E6
   åè½¬ç¬¬7ä½: 02:1B:63:FF:FE:84:45:E6

3. ç»„è£…é“¾è·¯æœ¬åœ°åœ°å€ï¼š
   å‰ç¼€fe80:: + EUI-64æ¥å£ID
   ç»“æœï¼šfe80::021b:63ff:fe84:45e6
```

#### ğŸ”¸ ç¬¬äºŒæ­¥ï¼šé‡å¤åœ°å€æ£€æµ‹ï¼ˆDADï¼‰

```
DADè¿‡ç¨‹ï¼šè®¾å¤‡ç¡®ä¿åœ°å€å”¯ä¸€æ€§
1. å‘é€é‚»å±…è¯·æ±‚ï¼ˆNSï¼‰åˆ°è‡ªå·±çš„åœ°å€
2. å¦‚æœæœ‰å›åº”ï¼Œè¯´æ˜åœ°å€å†²çª
3. å¦‚æœæ— å›åº”ï¼Œç¡®è®¤åœ°å€å¯ç”¨

DADæˆåŠŸï¼šåœ°å€çŠ¶æ€å˜ä¸º"preferred"
DADå¤±è´¥ï¼šåœ°å€çŠ¶æ€å˜ä¸º"duplicate"ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ
```

#### ğŸ”¸ ç¬¬ä¸‰æ­¥ï¼šè·¯ç”±å™¨å‘ç°

```
è·¯ç”±å™¨å‘ç°è¿‡ç¨‹ï¼š
1. è®¾å¤‡å‘é€è·¯ç”±å™¨è¯·æ±‚ï¼ˆRSï¼‰åˆ° ff02::2
2. è·¯ç”±å™¨å›åº”è·¯ç”±å™¨é€šå‘Šï¼ˆRAï¼‰
3. RAæ¶ˆæ¯åŒ…å«ï¼š
   â€¢ ç½‘ç»œå‰ç¼€ä¿¡æ¯
   â€¢ é»˜è®¤è·¯ç”±ä¿¡æ¯  
   â€¢ å…¶ä»–ç½‘ç»œå‚æ•°
```

#### ğŸ”¸ ç¬¬å››æ­¥ï¼šå…¨çƒåœ°å€é…ç½®

```
å…¨çƒåœ°å€ç”Ÿæˆï¼š
RAæä¾›çš„å‰ç¼€ï¼š2001:db8:1000:10::/64
æœ¬æœºæ¥å£IDï¼š ::021b:63ff:fe84:45e6
å®Œæ•´åœ°å€ï¼š   2001:db8:1000:10:021b:63ff:fe84:45e6/64

æœ€ç»ˆè®¾å¤‡æ‹¥æœ‰ä¸¤ä¸ªåœ°å€ï¼š
é“¾è·¯æœ¬åœ°ï¼šfe80::021b:63ff:fe84:45e6/64    ï¼ˆæœ¬åœ°é€šä¿¡ï¼‰
å…¨çƒå•æ’­ï¼š2001:db8:1000:10:021b:63ff:fe84:45e6/64 ï¼ˆäº’è”ç½‘é€šä¿¡ï¼‰
```

### 2.3 è·¯ç”±å™¨é€šå‘Šï¼ˆRAï¼‰é…ç½®


#### ğŸ”¸ å¯ç”¨IPv6è½¬å‘å’ŒRA


åœ¨Linuxè·¯ç”±å™¨ä¸Šé…ç½®ï¼š
```bash
# å¯ç”¨IPv6è½¬å‘
echo 1 > /proc/sys/net/ipv6/conf/all/forwarding

# é…ç½®æ¥å£å‘é€RA
# /etc/radvd.conf
interface eth0 {
    AdvSendAdvertisements on;           # å¯ç”¨RAå‘é€
    MinRtrAdvInterval 30;               # æœ€å°é€šå‘Šé—´éš”30ç§’
    MaxRtrAdvInterval 100;              # æœ€å¤§é€šå‘Šé—´éš”100ç§’
    AdvDefaultLifetime 1800;            # é»˜è®¤è·¯ç”±ç”Ÿå­˜æœŸ30åˆ†é’Ÿ
    
    prefix 2001:db8:1000:10::/64 {
        AdvOnLink on;                   # å‰ç¼€åœ¨æœ¬é“¾è·¯
        AdvAutonomous on;               # å…è®¸SLAAC
        AdvRouterAddr on;               # é€šå‘Šè·¯ç”±å™¨åœ°å€
        AdvPreferredLifetime 7200;      # é¦–é€‰ç”Ÿå­˜æœŸ2å°æ—¶
        AdvValidLifetime 86400;         # æœ‰æ•ˆç”Ÿå­˜æœŸ24å°æ—¶
    };
};
```

#### ğŸ”¸ RAæ¶ˆæ¯å†…å®¹è§£æ

```
å…¸å‹RAæ¶ˆæ¯åŒ…å«ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·¯ç”±å™¨é€šå‘Šæ¶ˆæ¯                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ è·³æ•°é™åˆ¶ï¼š64                      â”‚
â”‚ â€¢ Mæ ‡å¿—ï¼š0ï¼ˆä¸ä½¿ç”¨DHCPv6è·å–åœ°å€ï¼‰  â”‚
â”‚ â€¢ Oæ ‡å¿—ï¼š0ï¼ˆä¸ä½¿ç”¨DHCPv6è·å–å…¶ä»–ä¿¡æ¯ï¼‰â”‚
â”‚ â€¢ è·¯ç”±å™¨ç”Ÿå­˜æœŸï¼š1800ç§’              â”‚
â”‚ â€¢ å¯è¾¾æ—¶é—´ï¼š0ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰         â”‚
â”‚ â€¢ é‡ä¼ å®šæ—¶å™¨ï¼š0ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‰ç¼€ä¿¡æ¯é€‰é¡¹ï¼š                      â”‚
â”‚ â€¢ å‰ç¼€ï¼š2001:db8:1000:10::/64      â”‚
â”‚ â€¢ Læ ‡å¿—ï¼š1ï¼ˆé“¾è·¯æœ¬åœ°å‰ç¼€ï¼‰          â”‚
â”‚ â€¢ Aæ ‡å¿—ï¼š1ï¼ˆè‡ªæ²»é…ç½®ï¼‰              â”‚
â”‚ â€¢ æœ‰æ•ˆç”Ÿå­˜æœŸï¼š86400ç§’               â”‚
â”‚ â€¢ é¦–é€‰ç”Ÿå­˜æœŸï¼š7200ç§’                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 éšç§æ‰©å±•é…ç½®


**ä¸ºä»€ä¹ˆéœ€è¦éšç§æ‰©å±•ï¼Ÿ**
> EUI-64ç”Ÿæˆçš„æ¥å£IDåŒ…å«MACåœ°å€ï¼Œå¯èƒ½æ³„éœ²ç¡¬ä»¶ä¿¡æ¯ã€‚éšç§æ‰©å±•ç”Ÿæˆéšæœºæ¥å£IDï¼Œä¿æŠ¤ç”¨æˆ·éšç§ã€‚

#### ğŸ”¸ å¯ç”¨éšç§æ‰©å±•

```bash
# ä¸´æ—¶å¯ç”¨éšç§æ‰©å±•
echo 2 > /proc/sys/net/ipv6/conf/eth0/use_tempaddr

# æ°¸ä¹…é…ç½®ï¼ˆUbuntu/Debianï¼‰
# /etc/sysctl.conf
net.ipv6.conf.all.use_tempaddr = 2
net.ipv6.conf.default.use_tempaddr = 2
net.ipv6.conf.eth0.use_tempaddr = 2

# é…ç½®å«ä¹‰ï¼š
# 0 = ç¦ç”¨éšç§æ‰©å±•
# 1 = å¯ç”¨éšç§æ‰©å±•ï¼Œä½†ä¼˜å…ˆä½¿ç”¨EUI-64åœ°å€  
# 2 = å¯ç”¨éšç§æ‰©å±•ï¼Œä¼˜å…ˆä½¿ç”¨ä¸´æ—¶åœ°å€
```

#### ğŸ”¸ éšç§åœ°å€ç®¡ç†

```bash
# æŸ¥çœ‹åœ°å€çŠ¶æ€
ip -6 addr show eth0

# å…¸å‹è¾“å‡ºï¼š
# 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP>
#    inet6 2001:db8:1000:10:021b:63ff:fe84:45e6/64 scope global
#    inet6 2001:db8:1000:10:a1b2:c3d4:e5f6:7890/64 scope global temporary
#    inet6 fe80::021b:63ff:fe84:45e6/64 scope link

# åœ°å€è§£é‡Šï¼š
# ç¬¬ä¸€ä¸ªï¼šEUI-64åœ°å€ï¼ˆç¨³å®šï¼Œç”¨äºæœåŠ¡å™¨ï¼‰
# ç¬¬äºŒä¸ªï¼šä¸´æ—¶åœ°å€ï¼ˆå˜åŒ–ï¼Œç”¨äºå®¢æˆ·ç«¯ä¿æŠ¤éšç§ï¼‰  
# ç¬¬ä¸‰ä¸ªï¼šé“¾è·¯æœ¬åœ°åœ°å€
```

### 2.5 SLAACæ•…éšœè¯Šæ–­


#### ğŸ”¸ å¸¸è§é—®é¢˜ä¸è§£å†³


**é—®é¢˜1ï¼šæ— æ³•è·å–IPv6åœ°å€**
```bash
# æ£€æŸ¥è·¯ç”±å™¨é€šå‘Š
rdisc6 eth0

# æ‰‹åŠ¨å‘é€è·¯ç”±å™¨è¯·æ±‚
ndisc6 -r eth0

# æ£€æŸ¥IPv6æ˜¯å¦å¯ç”¨
cat /proc/sys/net/ipv6/conf/eth0/disable_ipv6
# 0è¡¨ç¤ºå¯ç”¨ï¼Œ1è¡¨ç¤ºç¦ç”¨
```

**é—®é¢˜2ï¼šåœ°å€å†²çª**
```bash
# æŸ¥çœ‹é‚»å±…è¡¨
ip -6 neigh show

# æ£€æŸ¥é‡å¤åœ°å€æ£€æµ‹çŠ¶æ€
ip -6 addr show eth0 | grep tentative
# tentativeçŠ¶æ€è¡¨ç¤ºåœ°å€æ­£åœ¨DADè¿‡ç¨‹ä¸­
```

**é—®é¢˜3ï¼šè·¯ç”±å™¨é€šå‘Šé…ç½®é”™è¯¯**
```bash
# æ£€æŸ¥radvdæœåŠ¡çŠ¶æ€
systemctl status radvd

# æŸ¥çœ‹radvdæ—¥å¿—
journalctl -u radvd

# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
radvd -C /etc/radvd.conf
```

**SLAACé…ç½®éªŒè¯æ¸…å•ï¼š**
```
âœ… æ£€æŸ¥é¡¹ç›®ï¼š
â–¡ IPv6è½¬å‘å·²å¯ç”¨
â–¡ radvdæœåŠ¡æ­£åœ¨è¿è¡Œ
â–¡ æ¥å£é…ç½®æ­£ç¡®çš„IPv6åœ°å€
â–¡ é˜²ç«å¢™å…è®¸ICMPv6æµé‡
â–¡ å®¢æˆ·ç«¯IPv6åŠŸèƒ½å·²å¯ç”¨
â–¡ ç½‘ç»œå‰ç¼€é…ç½®æ­£ç¡®
â–¡ RAé—´éš”è®¾ç½®åˆç†
â–¡ åœ°å€ç”Ÿå­˜æœŸé…ç½®é€‚å½“
```

---

## 3. ğŸ”§ IPv6é™æ€åœ°å€é…ç½®


### 3.1 é™æ€é…ç½®åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ—¶å€™éœ€è¦é™æ€IPv6åœ°å€ï¼Ÿ**
> é™æ€åœ°å€å°±åƒ"å›ºå®šé—¨ç‰Œå·"ï¼Œé€‚ç”¨äºéœ€è¦ç¨³å®šåœ°å€çš„è®¾å¤‡ï¼Œæ¯”å¦‚æœåŠ¡å™¨ã€è·¯ç”±å™¨ã€æ‰“å°æœºç­‰ã€‚è€Œè‡ªåŠ¨é…ç½®é€‚åˆæ™®é€šç”¨æˆ·è®¾å¤‡ã€‚

```
é™æ€é…ç½® vs è‡ªåŠ¨é…ç½®ï¼š

é™æ€é…ç½®é€‚ç”¨åœºæ™¯ï¼š
âœ… WebæœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨
âœ… DNSæœåŠ¡å™¨ã€é‚®ä»¶æœåŠ¡å™¨
âœ… ç½‘ç»œè®¾å¤‡ï¼ˆè·¯ç”±å™¨ã€äº¤æ¢æœºï¼‰
âœ… éœ€è¦ç«¯å£æ˜ å°„çš„æœåŠ¡
âœ… ç›‘æ§ç³»ç»Ÿã€æ—¥å¿—æœåŠ¡å™¨

è‡ªåŠ¨é…ç½®é€‚ç”¨åœºæ™¯ï¼š
âœ… æ™®é€šç”¨æˆ·ç”µè„‘ã€æ‰‹æœº
âœ… ä¸´æ—¶è¿æ¥è®¾å¤‡
âœ… å¤§é‡ç›¸åŒè®¾å¤‡æ‰¹é‡éƒ¨ç½²
âœ… ä¸éœ€è¦è¢«å¤–éƒ¨è®¿é—®çš„è®¾å¤‡
```

### 3.2 Linuxç³»ç»Ÿé™æ€é…ç½®


#### ğŸ”¸ ä½¿ç”¨ipå‘½ä»¤ä¸´æ—¶é…ç½®


```bash
# æ·»åŠ IPv6åœ°å€
ip -6 addr add 2001:db8:1000:10::100/64 dev eth0

# æ·»åŠ é»˜è®¤è·¯ç”±
ip -6 route add default via 2001:db8:1000:10::1 dev eth0

# æŸ¥çœ‹é…ç½®ç»“æœ
ip -6 addr show eth0
ip -6 route show

# åˆ é™¤IPv6åœ°å€
ip -6 addr del 2001:db8:1000:10::100/64 dev eth0
```

**é…ç½®éªŒè¯ï¼š**
```bash
# æµ‹è¯•è¿é€šæ€§
ping6 2001:db8:1000:10::1        # pingç½‘å…³
ping6 google.com                 # pingå…¬ç½‘ï¼ˆéœ€è¦DNSå·¥ä½œï¼‰

# æŸ¥çœ‹è·¯ç”±è¡¨
ip -6 route show table main
# ç¤ºä¾‹è¾“å‡ºï¼š
# 2001:db8:1000:10::/64 dev eth0 proto kernel metric 256
# default via 2001:db8:1000:10::1 dev eth0 metric 1024
```

#### ğŸ”¸ æ°¸ä¹…é™æ€é…ç½®æ–¹æ³•


**Ubuntu/Debianç³»ç»Ÿï¼ˆNetplanï¼‰ï¼š**
```yaml
# /etc/netplan/01-netcfg.yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      dhcp4: true
      dhcp6: false                    # ç¦ç”¨IPv6è‡ªåŠ¨é…ç½®
      addresses:
        - 2001:db8:1000:10::100/64   # é™æ€IPv6åœ°å€
      gateway6: 2001:db8:1000:10::1   # IPv6ç½‘å…³
      nameservers:
        addresses:
          - 2001:4860:4860::8888     # Google DNS IPv6
          - 2001:4860:4860::8844
        search:
          - example.com

# åº”ç”¨é…ç½®
sudo netplan apply
```

**CentOS/RHELç³»ç»Ÿé…ç½®ï¼š**
```bash
# /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes

# IPv4é…ç½®
IPADDR=192.168.1.100
NETMASK=255.255.255.0
GATEWAY=192.168.1.1

# IPv6é…ç½®
IPV6INIT=yes
IPV6_AUTOCONF=no                     # ç¦ç”¨è‡ªåŠ¨é…ç½®
IPV6ADDR=2001:db8:1000:10::100/64   # é™æ€åœ°å€
IPV6_DEFAULTGW=2001:db8:1000:10::1   # é»˜è®¤ç½‘å…³
DNS1=8.8.8.8
DNS2=2001:4860:4860::8888

# é‡å¯ç½‘ç»œæœåŠ¡
systemctl restart network
```

### 3.3 å¤šåœ°å€é…ç½®ç®¡ç†


#### ğŸ”¸ é…ç½®å¤šä¸ªIPv6åœ°å€

```bash
# ä¸»åœ°å€ï¼ˆç”¨äºæœåŠ¡ï¼‰
ip -6 addr add 2001:db8:1000:10::100/64 dev eth0

# å¤‡ç”¨åœ°å€ï¼ˆç”¨äºå†—ä½™ï¼‰
ip -6 addr add 2001:db8:1000:10::200/64 dev eth0

# ç®¡ç†åœ°å€ï¼ˆç”¨äºç»´æŠ¤ï¼‰
ip -6 addr add 2001:db8:1000:99::100/64 dev eth0

# æŸ¥çœ‹æ‰€æœ‰åœ°å€
ip -6 addr show eth0 | grep inet6
```

**åœ°å€ä¼˜å…ˆçº§é…ç½®ï¼š**
```bash
# æŸ¥çœ‹åœ°å€é€‰æ‹©ç­–ç•¥
cat /proc/net/if_inet6

# é…ç½®åœ°å€ä¼˜å…ˆçº§ï¼ˆä¸´æ—¶ï¼‰
echo "2001:db8:1000:10::100 scope global" > /proc/sys/net/ipv6/conf/eth0/preferred_lft

# æ°¸ä¹…ä¼˜å…ˆçº§é…ç½®éœ€è¦é€šè¿‡ç½‘ç»œé…ç½®æ–‡ä»¶å®ç°
```

### 3.4 æœåŠ¡å™¨é™æ€é…ç½®æœ€ä½³å®è·µ


#### ğŸ”¸ WebæœåŠ¡å™¨é…ç½®ç¤ºä¾‹

```bash
# WebæœåŠ¡å™¨IPv6é…ç½®
# ä¸»æœåŠ¡åœ°å€
ip -6 addr add 2001:db8:1000:2::80/64 dev eth0 

# ç®¡ç†æ¥å£åœ°å€  
ip -6 addr add 2001:db8:1000:99::80/64 dev eth1

# é…ç½®è·¯ç”±
ip -6 route add default via 2001:db8:1000:2::1 dev eth0

# éªŒè¯é…ç½®
ss -tlnp | grep :80    # æ£€æŸ¥IPv4ç›‘å¬
ss -6tlnp | grep :80   # æ£€æŸ¥IPv6ç›‘å¬
```

**Nginx IPv6é…ç½®ï¼š**
```nginx
# /etc/nginx/sites-available/default
server {
    # IPv4å’ŒIPv6åŒæ—¶ç›‘å¬
    listen 80;
    listen [::]:80;
    
    # HTTPSé…ç½®
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    
    server_name example.com;
    
    # ç¡®ä¿æ—¥å¿—è®°å½•çœŸå®å®¢æˆ·ç«¯IP
    set_real_ip_from 2001:db8:1000::/48;
    real_ip_header X-Forwarded-For;
}
```

#### ğŸ”¸ DNSæœåŠ¡å™¨é…ç½®ç¤ºä¾‹

```bash
# DNSæœåŠ¡å™¨é…ç½®
ip -6 addr add 2001:db8:1000:2::53/64 dev eth0

# é…ç½®é˜²ç«å¢™
ip6tables -A INPUT -p tcp --dport 53 -j ACCEPT
ip6tables -A INPUT -p udp --dport 53 -j ACCEPT
```

**BIND9 IPv6é…ç½®ï¼š**
```
# /etc/bind/named.conf.options
options {
    listen-on-v6 { any; };           # ç›‘å¬æ‰€æœ‰IPv6æ¥å£
    query-source-v6 address * port *; # IPv6æŸ¥è¯¢æºè®¾ç½®
    
    # IPv6é€’å½’æœåŠ¡å™¨
    forwarders {
        2001:4860:4860::8888;        # Google DNS
        2001:4860:4860::8844;
    };
};

# åŒºåŸŸæ–‡ä»¶IPv6è®°å½•
# /etc/bind/db.example.com
$TTL    604800
@       IN      SOA     ns1.example.com. admin.example.com. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL

@       IN      NS      ns1.example.com.
@       IN      A       192.168.1.100
@       IN      AAAA    2001:db8:1000:2::100    ; IPv6 Aè®°å½•

ns1     IN      A       192.168.1.53
ns1     IN      AAAA    2001:db8:1000:2::53

www     IN      A       192.168.1.80
www     IN      AAAA    2001:db8:1000:2::80
```

### 3.5 é™æ€é…ç½®æ•…éšœè¯Šæ–­


#### ğŸ”¸ å¸¸è§é…ç½®é—®é¢˜


**é—®é¢˜1ï¼šåœ°å€é…ç½®åæ— æ³•é€šä¿¡**
```bash
# æ£€æŸ¥åœ°å€æ˜¯å¦æ­£ç¡®é…ç½®
ip -6 addr show

# æ£€æŸ¥è·¯ç”±è¡¨
ip -6 route show

# æµ‹è¯•æœ¬åœ°è¿é€šæ€§
ping6 ::1                    # æµ‹è¯•æœ¬æœº
ping6 fe80::1%eth0          # æµ‹è¯•é“¾è·¯æœ¬åœ°ç½‘å…³

# æµ‹è¯•é‚»å±…å‘ç°
ip -6 neigh show
```

**é—®é¢˜2ï¼šIPv6æœåŠ¡æ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥æœåŠ¡ç›‘å¬çŠ¶æ€
ss -6tlnp                   # TCPæœåŠ¡
ss -6ulnp                   # UDPæœåŠ¡

# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
ip6tables -L -n -v

# æµ‹è¯•ç«¯å£è¿é€šæ€§
nc -6 -v 2001:db8:1000:2::80 80
```

**é—®é¢˜3ï¼šDNSè§£æé—®é¢˜**
```bash
# æµ‹è¯•IPv6 DNS
nslookup google.com 2001:4860:4860::8888

# æ£€æŸ¥/etc/resolv.conf
cat /etc/resolv.conf
# åº”åŒ…å«ï¼šnameserver 2001:4860:4860::8888

# æµ‹è¯•åŒæ ˆDNSè§£æ
dig google.com A        # IPv4è®°å½•
dig google.com AAAA     # IPv6è®°å½•
```

**é™æ€é…ç½®æ£€æŸ¥æ¸…å•ï¼š**
```
ğŸ” ç½‘ç»œå±‚æ£€æŸ¥ï¼š
â–¡ IPv6åœ°å€é…ç½®æ­£ç¡®
â–¡ å‰ç¼€é•¿åº¦æ­£ç¡®ï¼ˆé€šå¸¸æ˜¯/64ï¼‰
â–¡ é»˜è®¤è·¯ç”±æŒ‡å‘æ­£ç¡®ç½‘å…³
â–¡ DNSæœåŠ¡å™¨é…ç½®æ­£ç¡®

ğŸ” æœåŠ¡å±‚æ£€æŸ¥ï¼š
â–¡ æœåŠ¡ç»‘å®šåˆ°IPv6åœ°å€
â–¡ é˜²ç«å¢™å…è®¸IPv6æµé‡
â–¡ ç›‘å¬æ‰€æœ‰å¿…è¦ç«¯å£
â–¡ æ—¥å¿—è®°å½•IPv6è®¿é—®

ğŸ” è¿é€šæ€§æ£€æŸ¥ï¼š
â–¡ æœ¬åœ°è¿é€šæ€§æ­£å¸¸
â–¡ ç½‘å…³å¯è¾¾
â–¡ å…¬ç½‘è¿é€šæ€§æ­£å¸¸  
â–¡ DNSè§£æå·¥ä½œæ­£å¸¸
```

---

## 4. ğŸŒ‰ IPv4/IPv6åŒæ ˆç¯å¢ƒé…ç½®


### 4.1 åŒæ ˆåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯åŒæ ˆï¼Ÿ**
> åŒæ ˆå°±åƒ"åŒè¯­ç¯å¢ƒ"ï¼Œè®¾å¤‡æ—¢èƒ½è¯´IPv4"æ–¹è¨€"ä¹Ÿèƒ½è¯´IPv6"æ™®é€šè¯"ï¼Œå¯ä»¥å’Œä½¿ç”¨ä»»ä¸€åè®®çš„è®¾å¤‡æ­£å¸¸é€šä¿¡ï¼Œå®ç°å¹³æ»‘è¿‡æ¸¡ã€‚

```
åŒæ ˆå·¥ä½œåŸç†ï¼š

å•æ ˆIPv4è®¾å¤‡ï¼šåªèƒ½ä¸IPv4è®¾å¤‡é€šä¿¡
[IPv4è®¾å¤‡] â†â”€ IPv4 â”€â†’ [IPv4è®¾å¤‡] âœ…
[IPv4è®¾å¤‡] â†â”€ ??? â”€â†’ [IPv6è®¾å¤‡] âŒ

åŒæ ˆè®¾å¤‡ï¼šå¯ä»¥ä¸ä»»æ„è®¾å¤‡é€šä¿¡  
[åŒæ ˆè®¾å¤‡] â†â”€ IPv4 â”€â†’ [IPv4è®¾å¤‡] âœ…
[åŒæ ˆè®¾å¤‡] â†â”€ IPv6 â”€â†’ [IPv6è®¾å¤‡] âœ…
[åŒæ ˆè®¾å¤‡] â†â”€ IPv4/IPv6 â”€â†’ [åŒæ ˆè®¾å¤‡] âœ…
```

### 4.2 åŒæ ˆé…ç½®ç­–ç•¥


#### ğŸ”¸ ç½‘ç»œè§„åˆ’åŸåˆ™


**åœ°å€è§„åˆ’å¯¹åº”å…³ç³»ï¼š**
```
åŒæ ˆç½‘ç»œè§„åˆ’ç¤ºä¾‹ï¼š

å­ç½‘1ï¼ˆç®¡ç†ç½‘ç»œï¼‰ï¼š
IPv4ï¼š192.168.1.0/24
IPv6ï¼š2001:db8:1000:1::/64

å­ç½‘2ï¼ˆæœåŠ¡å™¨ç½‘ç»œï¼‰ï¼š
IPv4ï¼š192.168.2.0/24  
IPv6ï¼š2001:db8:1000:2::/64

å­ç½‘3ï¼ˆç”¨æˆ·ç½‘ç»œï¼‰ï¼š
IPv4ï¼š192.168.10.0/24
IPv6ï¼š2001:db8:1000:10::/64

è§„åˆ’è¦ç‚¹ï¼š
â€¢ IPv4å’ŒIPv6å­ç½‘åŠŸèƒ½å¯¹åº”
â€¢ æœåŠ¡å™¨åœ¨ä¸¤ä¸ªåè®®ä¸‹æä¾›ç›¸åŒæœåŠ¡
â€¢ DNSè®°å½•åŒ…å«Aå’ŒAAAAè®°å½•
â€¢ é˜²ç«å¢™è§„åˆ™ä¿æŒä¸€è‡´
```

#### ğŸ”¸ åŒæ ˆæ¥å£é…ç½®


**Linuxç³»ç»ŸåŒæ ˆé…ç½®ï¼š**
```bash
# é…ç½®IPv4åœ°å€
ip addr add 192.168.1.100/24 dev eth0
ip route add default via 192.168.1.1

# é…ç½®IPv6åœ°å€
ip -6 addr add 2001:db8:1000:1::100/64 dev eth0  
ip -6 route add default via 2001:db8:1000:1::1

# æŸ¥çœ‹åŒæ ˆé…ç½®
ip addr show eth0
# è¾“å‡ºåº”åŒæ—¶åŒ…å«IPv4å’ŒIPv6åœ°å€

# æŸ¥çœ‹åŒæ ˆè·¯ç”±
ip route show        # IPv4è·¯ç”±
ip -6 route show     # IPv6è·¯ç”±
```

**æ°¸ä¹…åŒæ ˆé…ç½®ï¼ˆNetplanï¼‰ï¼š**
```yaml
# /etc/netplan/01-netcfg.yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      # IPv4é…ç½®
      dhcp4: false
      addresses:
        - 192.168.1.100/24
      gateway4: 192.168.1.1
      
      # IPv6é…ç½®  
      dhcp6: false
      addresses:
        - 2001:db8:1000:1::100/64
      gateway6: 2001:db8:1000:1::1
      
      # åŒæ ˆDNS
      nameservers:
        addresses:
          - 8.8.8.8                    # IPv4 DNS
          - 2001:4860:4860::8888       # IPv6 DNS
          - 1.1.1.1                    # å¤‡ç”¨IPv4 DNS
          - 2606:4700:4700::1111       # å¤‡ç”¨IPv6 DNS
```

### 4.3 åŒæ ˆæœåŠ¡é…ç½®


#### ğŸ”¸ WebæœåŠ¡å™¨åŒæ ˆé…ç½®


**ApacheåŒæ ˆé…ç½®ï¼š**
```apache
# /etc/apache2/sites-available/000-default.conf

# ç›‘å¬IPv4å’ŒIPv6
Listen 80
Listen [::]:80
Listen 443
Listen [::]:443

<VirtualHost *:80 [::]:80>
    ServerName example.com
    DocumentRoot /var/www/html
    
    # æ—¥å¿—è®°å½•åŒæ ˆè®¿é—®
    LogFormat "%h %l %u %t \"%r\" %>s %O" combined_v4
    LogFormat "%{::ffff:}a %l %u %t \"%r\" %>s %O" combined_v6
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

# HTTPSåŒæ ˆé…ç½®
<VirtualHost *:443 [::]:443>
    ServerName example.com
    DocumentRoot /var/www/html
    
    SSLEngine on
    SSLCertificateFile /path/to/cert.pem
    SSLCertificateKeyFile /path/to/private.key
</VirtualHost>
```

**NginxåŒæ ˆé…ç½®ï¼š**
```nginx
# /etc/nginx/sites-available/default
server {
    # åŒæ—¶ç›‘å¬IPv4å’ŒIPv6
    listen 80;
    listen [::]:80;
    
    server_name example.com;
    
    # è·å–çœŸå®å®¢æˆ·ç«¯IPï¼ˆåŒæ ˆï¼‰
    set_real_ip_from 192.168.0.0/16;      # IPv4å†…ç½‘
    set_real_ip_from 2001:db8::/32;       # IPv6å†…ç½‘
    real_ip_header X-Forwarded-For;
    
    location / {
        root /var/www/html;
        index index.html;
        
        # è®°å½•å®¢æˆ·ç«¯åè®®ç‰ˆæœ¬
        access_log /var/log/nginx/access.log combined;
    }
}
```

#### ğŸ”¸ DNSæœåŠ¡å™¨åŒæ ˆé…ç½®


**BIND9åŒæ ˆé…ç½®ï¼š**
```
# /etc/bind/named.conf.options
options {
    # åŒæ—¶ç›‘å¬IPv4å’ŒIPv6
    listen-on { any; };
    listen-on-v6 { any; };
    
    # åŒæ ˆæŸ¥è¯¢æº
    query-source address * port *;
    query-source-v6 address * port *;
    
    # åŒæ ˆè½¬å‘å™¨
    forwarders {
        8.8.8.8;                      # IPv4
        2001:4860:4860::8888;         # IPv6
    };
};

# åŒºåŸŸé…ç½®åŒæ ˆè®°å½•
# /etc/bind/db.example.com
$TTL    604800
@       IN      SOA     ns1.example.com. admin.example.com. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry  
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL

@       IN      NS      ns1.example.com.

# åŒæ ˆä¸»æœºè®°å½•
@       IN      A       192.168.1.100           ; IPv4
@       IN      AAAA    2001:db8:1000:1::100    ; IPv6

www     IN      A       192.168.1.80
www     IN      AAAA    2001:db8:1000:1::80

mail    IN      A       192.168.1.25
mail    IN      AAAA    2001:db8:1000:1::25

# MXè®°å½•æŒ‡å‘åŒæ ˆä¸»æœº
@       IN      MX      10 mail.example.com.
```

### 4.4 åŒæ ˆè·¯ç”±é…ç½®


#### ğŸ”¸ è·¯ç”±å™¨åŒæ ˆé…ç½®


**Linuxè·¯ç”±å™¨é…ç½®ï¼š**
```bash
# å¯ç”¨è½¬å‘
echo 1 > /proc/sys/net/ipv4/ip_forward
echo 1 > /proc/sys/net/ipv6/conf/all/forwarding

# å†…ç½‘æ¥å£é…ç½®
ip addr add 192.168.1.1/24 dev eth0          # IPv4å†…ç½‘
ip -6 addr add 2001:db8:1000:1::1/64 dev eth0 # IPv6å†…ç½‘

# å¤–ç½‘æ¥å£é…ç½®
ip addr add 203.0.113.10/30 dev eth1         # IPv4å…¬ç½‘
ip -6 addr add 2001:db8:2000::10/64 dev eth1 # IPv6å…¬ç½‘

# é»˜è®¤è·¯ç”±
ip route add default via 203.0.113.9
ip -6 route add default via 2001:db8:2000::1

# å¯ç”¨NATï¼ˆIPv4ï¼‰å’Œè·¯ç”±é€šå‘Šï¼ˆIPv6ï¼‰
iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE
radvd -C /etc/radvd.conf
```

**radvdåŒæ ˆç¯å¢ƒé…ç½®ï¼š**
```
# /etc/radvd.conf
interface eth0 {
    AdvSendAdvertisements on;
    MaxRtrAdvInterval 60;
    
    # IPv6å‰ç¼€é€šå‘Š
    prefix 2001:db8:1000:1::/64 {
        AdvOnLink on;
        AdvAutonomous on;
        AdvRouterAddr on;
    };
    
    # DNSæœåŠ¡å™¨é€šå‘Šï¼ˆRFC 6106ï¼‰
    RDNSS 2001:db8:1000:1::1 {
        AdvRDNSSLifetime 300;
    };
};
```

### 4.5 åŒæ ˆä¼˜å…ˆçº§å’Œç­–ç•¥


#### ğŸ”¸ åœ°å€é€‰æ‹©ç­–ç•¥


**IPv6ä¼˜å…ˆç­–ç•¥é…ç½®ï¼š**
```bash
# æŸ¥çœ‹å½“å‰ç­–ç•¥è¡¨
cat /proc/net/if_inet6

# ä¸´æ—¶ä¿®æ”¹ä¼˜å…ˆçº§ï¼ˆåå¥½IPv6ï¼‰
echo "label ::1/128 0" > /proc/sys/net/ipv6/conf/all/policy
echo "label ::/0 1" >> /proc/sys/net/ipv6/conf/all/policy
echo "label 2002::/16 2" >> /proc/sys/net/ipv6/conf/all/policy
echo "label ::/96 3" >> /proc/sys/net/ipv6/conf/all/policy
echo "label ::ffff:0:0/96 4" >> /proc/sys/net/ipv6/conf/all/policy

# æ°¸ä¹…é…ç½®éœ€è¦ä¿®æ”¹ /etc/gai.conf
```

**åº”ç”¨ç¨‹åºåŒæ ˆè¡Œä¸ºï¼š**
```bash
# æµ‹è¯•åŒæ ˆè¿æ¥ä¼˜å…ˆçº§
curl -4 http://google.com      # å¼ºåˆ¶IPv4
curl -6 http://google.com      # å¼ºåˆ¶IPv6  
curl http://google.com         # è‡ªåŠ¨é€‰æ‹©

# ç›‘æ§è¿æ¥ä½¿ç”¨çš„åè®®
ss -tuln | grep :80           # æŸ¥çœ‹ç›‘å¬
ss -tun | grep ESTAB          # æŸ¥çœ‹æ´»åŠ¨è¿æ¥
```

### 4.6 åŒæ ˆç¯å¢ƒç›‘æ§


#### ğŸ”¸ æµé‡ç›‘æ§å’Œåˆ†æ


**åŒæ ˆæµé‡ç»Ÿè®¡ï¼š**
```bash
# æŸ¥çœ‹IPv4æµé‡
cat /proc/net/dev

# æŸ¥çœ‹IPv6æµé‡  
cat /proc/net/if_inet6

# ä½¿ç”¨netstatç›‘æ§åŒæ ˆè¿æ¥
netstat -46 -tuln             # ç›‘å¬ç«¯å£
netstat -46 -tun              # æ´»åŠ¨è¿æ¥

# è¯¦ç»†çš„åŒæ ˆç»Ÿè®¡
ip -4 -s link show            # IPv4ç»Ÿè®¡
ip -6 -s link show            # IPv6ç»Ÿè®¡
```

**æ€§èƒ½å¯¹æ¯”ç›‘æ§ï¼š**
```bash
# åŒæ ˆpingæµ‹è¯•
ping -c 10 8.8.8.8                      # IPv4å»¶è¿Ÿ
ping6 -c 10 2001:4860:4860::8888        # IPv6å»¶è¿Ÿ

# å¸¦å®½æµ‹è¯•
iperf3 -c speedtest.example.com -4      # IPv4å¸¦å®½
iperf3 -c speedtest.example.com -6      # IPv6å¸¦å®½

# DNSè§£æé€Ÿåº¦å¯¹æ¯”
time nslookup google.com 8.8.8.8        # IPv4 DNS
time nslookup google.com 2001:4860:4860::8888  # IPv6 DNS
```

**åŒæ ˆé…ç½®æœ€ä½³å®è·µï¼š**
```
ğŸ¯ è§„åˆ’é˜¶æ®µï¼š
â€¢ ç¡®ä¿IPv4å’ŒIPv6ç½‘æ®µå¯¹åº”
â€¢ è§„åˆ’ç»Ÿä¸€çš„æœåŠ¡ç«¯å£ç­–ç•¥
â€¢ è®¾è®¡ä¸€è‡´çš„å®‰å…¨ç­–ç•¥

ğŸ¯ é…ç½®é˜¶æ®µï¼š  
â€¢ åŒæ—¶é…ç½®ä¸¤ä¸ªåè®®æ ˆ
â€¢ ç¡®ä¿æœåŠ¡ç›‘å¬åŒæ ˆæ¥å£
â€¢ é…ç½®åŒæ ˆDNSè®°å½•

ğŸ¯ è¿ç»´é˜¶æ®µï¼š
â€¢ ç›‘æ§åŒåè®®æ ˆæµé‡
â€¢ ç»´æŠ¤åŒæ ˆé˜²ç«å¢™è§„åˆ™
â€¢ å®šæœŸæµ‹è¯•ä¸¤ä¸ªåè®®çš„è¿é€šæ€§

ğŸ¯ æ•…éšœå¤„ç†ï¼š
â€¢ åˆ†åˆ«æµ‹è¯•IPv4å’ŒIPv6è¿é€šæ€§
â€¢ æ£€æŸ¥åŒæ ˆæœåŠ¡ç›‘å¬çŠ¶æ€
â€¢ éªŒè¯DNSåŒæ ˆè®°å½•æ­£ç¡®æ€§
```

---

## 5. ğŸ” IPv6é‚»å±…å‘ç°åè®®


### 5.1 NDPåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯é‚»å±…å‘ç°åè®®ï¼Ÿ**
> NDPå°±åƒIPv6ç½‘ç»œä¸­çš„"æ™ºèƒ½é€šè®¯å½•"ï¼Œä¸ä»…èƒ½æ‰¾åˆ°é‚»å±…çš„"è”ç³»æ–¹å¼"ï¼ˆMACåœ°å€ï¼‰ï¼Œè¿˜èƒ½è‡ªåŠ¨å‘ç°ç½‘ç»œé…ç½®ã€æ£€æµ‹åœ°å€å†²çªï¼Œæ¯”IPv4çš„ARPåŠŸèƒ½æ›´å¼ºå¤§ã€‚

```
NDP vs ARP åŠŸèƒ½å¯¹æ¯”ï¼š

IPv4 ARPåŠŸèƒ½ï¼š
â€¢ IPåœ°å€åˆ°MACåœ°å€æ˜ å°„
â€¢ ä»…æ­¤è€Œå·²

IPv6 NDPåŠŸèƒ½ï¼š  
â€¢ IPv6åœ°å€åˆ°MACåœ°å€æ˜ å°„ âœ“
â€¢ è·¯ç”±å™¨å‘ç° âœ“
â€¢ å‰ç¼€å‘ç° âœ“
â€¢ åœ°å€è‡ªåŠ¨é…ç½® âœ“
â€¢ é‡å¤åœ°å€æ£€æµ‹ âœ“
â€¢ é‚»å±…ä¸å¯è¾¾æ£€æµ‹ âœ“
â€¢ é‡å®šå‘å¤„ç† âœ“
```

### 5.2 NDPæ¶ˆæ¯ç±»å‹è¯¦è§£


#### ğŸ”¸ äº”ç§ICMPv6æ¶ˆæ¯ç±»å‹


| **æ¶ˆæ¯ç±»å‹** | **ä»£ç ** | **åŠŸèƒ½è¯´æ˜** | **å‘é€è€…** | **ç”¨é€”** |
|-------------|---------|-------------|-----------|----------|
| **è·¯ç”±å™¨è¯·æ±‚ï¼ˆRSï¼‰** | `133` | è¯·æ±‚è·¯ç”±å™¨ä¿¡æ¯ | ä¸»æœº | å¿«é€Ÿè·å–ç½‘ç»œé…ç½® |
| **è·¯ç”±å™¨é€šå‘Šï¼ˆRAï¼‰** | `134` | é€šå‘Šç½‘ç»œå‰ç¼€å’Œå‚æ•° | è·¯ç”±å™¨ | æä¾›è‡ªåŠ¨é…ç½®ä¿¡æ¯ |
| **é‚»å±…è¯·æ±‚ï¼ˆNSï¼‰** | `135` | è¯·æ±‚é‚»å±…MACåœ°å€æˆ–æ£€æµ‹åœ°å€å†²çª | ä»»æ„èŠ‚ç‚¹ | åœ°å€è§£æå’ŒDAD |
| **é‚»å±…é€šå‘Šï¼ˆNAï¼‰** | `136` | å›åº”é‚»å±…è¯·æ±‚ | ç›®æ ‡èŠ‚ç‚¹ | æä¾›MACåœ°å€ä¿¡æ¯ |
| **é‡å®šå‘ï¼ˆRedirectï¼‰** | `137` | æŒ‡ç¤ºæ›´ä¼˜è·¯å¾„ | è·¯ç”±å™¨ | è·¯ç”±ä¼˜åŒ– |

#### ğŸ”¸ é‚»å±…è¯·æ±‚ï¼ˆNSï¼‰è¯¦è§£

```
NSæ¶ˆæ¯ç”¨é€”ï¼š
1. åœ°å€è§£æï¼šè·å–IPv6åœ°å€å¯¹åº”çš„MACåœ°å€
2. é‡å¤åœ°å€æ£€æµ‹ï¼ˆDADï¼‰ï¼šæ£€æŸ¥åœ°å€æ˜¯å¦è¢«å ç”¨  
3. é‚»å±…ä¸å¯è¾¾æ£€æµ‹ï¼ˆNUDï¼‰ï¼šæ£€æŸ¥é‚»å±…æ˜¯å¦ä»ç„¶å¯è¾¾

NSæ¶ˆæ¯ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPv6å¤´éƒ¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ICMPv6å¤´éƒ¨                         â”‚
â”‚ â€¢ ç±»å‹ï¼š135                        â”‚
â”‚ â€¢ ä»£ç ï¼š0                          â”‚
â”‚ â€¢ æ ¡éªŒå’Œï¼šè®¡ç®—å€¼                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ NSæ¶ˆæ¯ä½“                           â”‚
â”‚ â€¢ ç›®æ ‡åœ°å€ï¼šè¦è§£æçš„IPv6åœ°å€        â”‚
â”‚ â€¢ æºé“¾è·¯å±‚åœ°å€é€‰é¡¹ï¼ˆå¯é€‰ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ”¸ é‚»å±…é€šå‘Šï¼ˆNAï¼‰è¯¦è§£

```
NAæ¶ˆæ¯ç»“æ„å’Œæ ‡å¿—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NAæ¶ˆæ¯ä½“                           â”‚
â”‚ â€¢ Ræ ‡å¿—ï¼šè·¯ç”±å™¨æ ‡å¿—                 â”‚
â”‚ â€¢ Sæ ‡å¿—ï¼šè¯·æ±‚æ ‡å¿—                   â”‚
â”‚ â€¢ Oæ ‡å¿—ï¼šè¦†ç›–æ ‡å¿—                   â”‚
â”‚ â€¢ ç›®æ ‡åœ°å€ï¼šé€šå‘Šçš„IPv6åœ°å€          â”‚
â”‚ â€¢ ç›®æ ‡é“¾è·¯å±‚åœ°å€é€‰é¡¹                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ‡å¿—å«ä¹‰ï¼š
R=1ï¼šå‘é€è€…æ˜¯è·¯ç”±å™¨
S=1ï¼šè¿™æ˜¯å¯¹NSçš„å“åº”
O=1ï¼šåº”è¯¥è¦†ç›–ç°æœ‰çš„ç¼“å­˜æ¡ç›®
```

### 5.3 åœ°å€è§£æè¿‡ç¨‹


#### ğŸ”¸ é‚»å±…è¡¨çŠ¶æ€æœº

```
é‚»å±…è¡¨æ¡ç›®çŠ¶æ€ï¼š

INCOMPLETEï¼ˆä¸å®Œæ•´ï¼‰ï¼š
â€¢ å·²å‘é€NSï¼Œç­‰å¾…NAå“åº”
â€¢ çŠ¶æ€æŒç»­æ—¶é—´ï¼šå‡ ç§’é’Ÿ
â€¢ è¶…æ—¶ååˆ é™¤æ¡ç›®

REACHABLEï¼ˆå¯è¾¾ï¼‰ï¼š
â€¢ æ”¶åˆ°NAç¡®è®¤ï¼Œåœ°å€å¯è¾¾
â€¢ çŠ¶æ€æŒç»­æ—¶é—´ï¼š30ç§’ï¼ˆé»˜è®¤ï¼‰
â€¢ æœŸé—´å¯ä»¥æ­£å¸¸å‘é€æ•°æ®

STALEï¼ˆè¿‡æœŸï¼‰ï¼š
â€¢ å¯è¾¾æ—¶é—´è¿‡æœŸï¼Œä½†æœªç¡®è®¤ä¸å¯è¾¾
â€¢ ä¸‹æ¬¡ä½¿ç”¨æ—¶è§¦å‘NUDè¿‡ç¨‹
â€¢ ä»ç„¶å¯ä»¥å‘é€æ•°æ®

PROBEï¼ˆæ¢æµ‹ï¼‰ï¼š
â€¢ ä¸»åŠ¨å‘é€NSæ£€æµ‹å¯è¾¾æ€§
â€¢ è¿ç»­å‘é€3æ¬¡NSï¼ˆé»˜è®¤ï¼‰
â€¢ è¶…æ—¶åå˜ä¸ºUNREACHABLE

UNREACHABLEï¼ˆä¸å¯è¾¾ï¼‰ï¼š
â€¢ ç¡®è®¤é‚»å±…ä¸å¯è¾¾
â€¢ ä¸Šå±‚åè®®åº”è¯¥é€‰æ‹©å…¶ä»–è·¯å¾„
â€¢ ä¸€æ®µæ—¶é—´ååˆ é™¤æ¡ç›®
```

#### ğŸ”¸ åœ°å€è§£æç¤ºä¾‹è¿‡ç¨‹

```
åœºæ™¯ï¼šä¸»æœºAï¼ˆ2001:db8::1ï¼‰è¦å‘é€æ•°æ®ç»™ä¸»æœºBï¼ˆ2001:db8::2ï¼‰

ç¬¬1æ­¥ï¼šæ£€æŸ¥é‚»å±…ç¼“å­˜
ä¸»æœºAæ£€æŸ¥é‚»å±…è¡¨ï¼Œå‘ç°æ²¡æœ‰ä¸»æœºBçš„MACåœ°å€

ç¬¬2æ­¥ï¼šå‘é€é‚»å±…è¯·æ±‚  
æºåœ°å€ï¼š2001:db8::1
ç›®çš„åœ°å€ï¼šff02::1:ff00:2 ï¼ˆè¯·æ±‚èŠ‚ç‚¹ç»„æ’­åœ°å€ï¼‰
NSæ¶ˆæ¯ï¼šç›®æ ‡åœ°å€=2001:db8::2ï¼ŒæºMAC=ä¸»æœºAçš„MAC

ç¬¬3æ­¥ï¼šä¸»æœºBå“åº”
ä¸»æœºBæ”¶åˆ°NSï¼Œå‘é€NAå“åº”
æºåœ°å€ï¼š2001:db8::2  
ç›®çš„åœ°å€ï¼š2001:db8::1
NAæ¶ˆæ¯ï¼šç›®æ ‡åœ°å€=2001:db8::2ï¼Œç›®æ ‡MAC=ä¸»æœºBçš„MAC

ç¬¬4æ­¥ï¼šæ›´æ–°é‚»å±…ç¼“å­˜
ä¸»æœºAå°†ä¸»æœºBçš„æ¡ç›®æ·»åŠ åˆ°é‚»å±…è¡¨ï¼ŒçŠ¶æ€ä¸ºREACHABLE

ç¬¬5æ­¥ï¼šå‘é€æ•°æ®åŒ…
ä¸»æœºAä½¿ç”¨è·å¾—çš„MACåœ°å€å°è£…ä»¥å¤ªç½‘å¸§ï¼Œå‘é€æ•°æ®
```

### 5.4 é‡å¤åœ°å€æ£€æµ‹ï¼ˆDADï¼‰


#### ğŸ”¸ DADå·¥ä½œæµç¨‹

```
DADè¿‡ç¨‹ï¼šç¡®ä¿IPv6åœ°å€åœ¨é“¾è·¯ä¸Šå”¯ä¸€

ç¬¬1æ­¥ï¼šåœ°å€ç”Ÿæˆ
è®¾å¤‡ç”ŸæˆIPv6åœ°å€ï¼ˆæ‰‹åŠ¨é…ç½®æˆ–è‡ªåŠ¨é…ç½®ï¼‰

ç¬¬2æ­¥ï¼šè®¾ç½®tentativeçŠ¶æ€
åœ°å€æ ‡è®°ä¸º"tentative"ï¼ˆæš‚å®šï¼‰ï¼Œæš‚æ—¶ä¸èƒ½ç”¨äºé€šä¿¡

ç¬¬3æ­¥ï¼šå‘é€NSè¿›è¡ŒDAD
æºåœ°å€ï¼š:: ï¼ˆæœªæŒ‡å®šåœ°å€ï¼‰
ç›®çš„åœ°å€ï¼šå¯¹åº”çš„è¯·æ±‚èŠ‚ç‚¹ç»„æ’­åœ°å€
NSæ¶ˆæ¯ï¼šç›®æ ‡åœ°å€=è¦æ£€æµ‹çš„åœ°å€ï¼Œæ— æºé“¾è·¯å±‚åœ°å€é€‰é¡¹

ç¬¬4æ­¥ï¼šç­‰å¾…å“åº”
ç­‰å¾…DupAddrDetectTransmits Ã— RetransTimeræ—¶é—´
é»˜è®¤ï¼š1æ¬¡ Ã— 1000ms = 1ç§’

ç¬¬5æ­¥ï¼šåˆ¤æ–­ç»“æœ
æ— å“åº”ï¼šåœ°å€å”¯ä¸€ï¼Œæ ‡è®°ä¸º"preferred"
æœ‰å“åº”ï¼šåœ°å€å†²çªï¼Œæ ‡è®°ä¸º"duplicate"ï¼Œåœç”¨åœ°å€
```

#### ğŸ”¸ DADé…ç½®å’Œç›‘æ§

```bash
# æŸ¥çœ‹DADé…ç½®å‚æ•°
cat /proc/sys/net/ipv6/conf/eth0/dad_transmits
# 1è¡¨ç¤ºå‘é€1æ¬¡DAD NSæ¶ˆæ¯

# ä¿®æ”¹DADé‡è¯•æ¬¡æ•°
echo 3 > /proc/sys/net/ipv6/conf/eth0/dad_transmits

# æŸ¥çœ‹åœ°å€çŠ¶æ€
ip -6 addr show eth0
# tentativeï¼šæ­£åœ¨è¿›è¡ŒDAD
# preferredï¼šDADæˆåŠŸï¼Œåœ°å€å¯ç”¨
# duplicateï¼šDADå¤±è´¥ï¼Œåœ°å€å†²çª

# æ‰‹åŠ¨è§¦å‘DAD
echo 0 > /proc/sys/net/ipv6/conf/eth0/accept_dad
echo 1 > /proc/sys/net/ipv6/conf/eth0/accept_dad
```

### 5.5 é‚»å±…ä¸å¯è¾¾æ£€æµ‹ï¼ˆNUDï¼‰


#### ğŸ”¸ NUDå·¥ä½œæœºåˆ¶

```
NUDè§¦å‘æ¡ä»¶ï¼š
â€¢ é‚»å±…è¡¨æ¡ç›®ä»REACHABLEå˜ä¸ºSTALE
â€¢ å‘é€æ•°æ®åŒ…ç»™STALEçŠ¶æ€çš„é‚»å±…
â€¢ å®šæœŸçš„é‚»å±…å¯è¾¾æ€§æ£€æŸ¥

NUDæ£€æµ‹è¿‡ç¨‹ï¼š
ç¬¬1æ­¥ï¼šçŠ¶æ€å˜ä¸ºPROBE
ç¬¬2æ­¥ï¼šå‘é€NSåˆ°ç›®æ ‡åœ°å€ï¼ˆå•æ’­ï¼‰
ç¬¬3æ­¥ï¼šè®¾ç½®é‡ä¼ å®šæ—¶å™¨
ç¬¬4æ­¥ï¼šç­‰å¾…NAå“åº”
ç¬¬5æ­¥ï¼šé‡è¯•æˆ–æ ‡è®°UNREACHABLE
```

**NUDé…ç½®å‚æ•°ï¼š**
```bash
# æŸ¥çœ‹NUDç›¸å…³å‚æ•°
cat /proc/sys/net/ipv6/neigh/eth0/base_reachable_time  # åŸºæœ¬å¯è¾¾æ—¶é—´
cat /proc/sys/net/ipv6/neigh/eth0/retrans_time         # é‡ä¼ é—´éš”
cat /proc/sys/net/ipv6/neigh/eth0/ucast_solicit        # å•æ’­æ¢æµ‹æ¬¡æ•°

# è°ƒæ•´NUDå‚æ•°
echo 45000 > /proc/sys/net/ipv6/neigh/eth0/base_reachable_time  # 45ç§’
echo 1500 > /proc/sys/net/ipv6/neigh/eth0/retrans_time          # 1.5ç§’
echo 5 > /proc/sys/net/ipv6/neigh/eth0/ucast_solicit            # 5æ¬¡é‡è¯•
```

### 5.6 NDPå®ç”¨å·¥å…·


#### ğŸ”¸ é‚»å±…è¡¨ç®¡ç†

```bash
# æŸ¥çœ‹é‚»å±…è¡¨
ip -6 neigh show
# å…¸å‹è¾“å‡ºï¼š
# 2001:db8::1 dev eth0 lladdr 00:1b:63:84:45:e6 REACHABLE
# 2001:db8::2 dev eth0 lladdr 00:1b:63:84:45:e7 STALE
# fe80::1 dev eth0 lladdr 00:1b:63:84:45:e8 router REACHABLE

# æ‰‹åŠ¨æ·»åŠ é‚»å±…æ¡ç›®
ip -6 neigh add 2001:db8::100 lladdr 00:1b:63:84:45:e9 dev eth0

# åˆ é™¤é‚»å±…æ¡ç›®
ip -6 neigh del 2001:db8::100 dev eth0

# åˆ·æ–°é‚»å±…è¡¨
ip -6 neigh flush dev eth0
```

#### ğŸ”¸ NDPè°ƒè¯•å·¥å…·

```bash
# ç›‘æ§NDPæ¶ˆæ¯
tcpdump -i eth0 icmp6
# æˆ–è€…æ›´å…·ä½“çš„è¿‡æ»¤
tcpdump -i eth0 'icmp6 and (ip6[40] == 135 or ip6[40] == 136)'

# ä½¿ç”¨ndisc6å·¥å…·åŒ…
# å‘é€NSæ¶ˆæ¯
ndisc6 2001:db8::2 eth0

# å‘é€RSæ¶ˆæ¯
rdisc6 eth0

# è·å–è·¯ç”±å™¨ä¿¡æ¯
rdisc6 -v eth0

# æµ‹è¯•DAD
addr6 -d 2001:db8::100 eth0
```

### 5.7 NDPå®‰å…¨è€ƒè™‘


#### ğŸ”¸ NDPå®‰å…¨å¨èƒ

```
å¸¸è§NDPæ”»å‡»ï¼š
â€¢ é‚»å±…è¡¨ä¸­æ¯’ï¼šå‘é€è™šå‡NAæ¶ˆæ¯
â€¢ DADæ”»å‡»ï¼šé˜»æ­¢åˆæ³•åœ°å€é…ç½®
â€¢ è·¯ç”±å™¨å†’å……ï¼šå‘é€è™šå‡RAæ¶ˆæ¯
â€¢ é‡å®šå‘æ”»å‡»ï¼šè¯±å¯¼æµé‡åˆ°æ¶æ„è·¯å¾„

é˜²æŠ¤æªæ–½ï¼š
â€¢ å¯ç”¨RA GuardåŠŸèƒ½
â€¢ é…ç½®DHCPv6 Guard
â€¢ ä½¿ç”¨IPv6æºåœ°å€éªŒè¯
â€¢ éƒ¨ç½²IPv6é˜²ç«å¢™è§„åˆ™
```

#### ğŸ”¸ NDPå®‰å…¨é…ç½®

```bash
# ç¦ç”¨æ¥å—æ‰€æœ‰RAï¼ˆä»…åœ¨ç¡®å®šç¯å¢ƒä¸­ï¼‰
echo 0 > /proc/sys/net/ipv6/conf/eth0/accept_ra

# ç¦ç”¨è‡ªåŠ¨é…ç½®ï¼ˆå¼ºåˆ¶é™æ€é…ç½®ï¼‰
echo 0 > /proc/sys/net/ipv6/conf/eth0/autoconf

# é™åˆ¶RAå¤„ç†
echo 1 > /proc/sys/net/ipv6/conf/eth0/accept_ra_defrtr  # åªæ¥å—é»˜è®¤è·¯ç”±
echo 1 > /proc/sys/net/ipv6/conf/eth0/accept_ra_pinfo   # åªæ¥å—å‰ç¼€ä¿¡æ¯

# é…ç½®IPv6é˜²ç«å¢™ä¿æŠ¤NDP
ip6tables -A INPUT -p icmpv6 --icmpv6-type 134 -m hl --hl-eq 255 -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type 135 -m hl --hl-eq 255 -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type 136 -m hl --hl-eq 255 -j ACCEPT
```

**NDPæ•…éšœè¯Šæ–­è¦ç‚¹ï¼š**
```
ğŸ” åœ°å€è§£æé—®é¢˜ï¼š
â€¢ æ£€æŸ¥é‚»å±…è¡¨çŠ¶æ€
â€¢ ç›‘æ§NS/NAæ¶ˆæ¯äº¤æ¢
â€¢ éªŒè¯é“¾è·¯å±‚è¿é€šæ€§

ğŸ” DADå¤±è´¥é—®é¢˜ï¼š
â€¢ æ£€æŸ¥åœ°å€å†²çª
â€¢ æŸ¥çœ‹ç½‘ç»œä¸­é‡å¤è®¾å¤‡
â€¢ éªŒè¯DADé…ç½®å‚æ•°

ğŸ” NUDå¼‚å¸¸é—®é¢˜ï¼š
â€¢ è°ƒæ•´NUDè¶…æ—¶å‚æ•°
â€¢ æ£€æŸ¥ç½‘ç»œç¨³å®šæ€§
â€¢ ç›‘æ§PROBE/UNREACHABLEçŠ¶æ€

ğŸ” æ€§èƒ½ä¼˜åŒ–ï¼š
â€¢ è°ƒæ•´é‚»å±…è¡¨å¤§å°
â€¢ ä¼˜åŒ–ç¼“å­˜æ—¶é—´
â€¢ é…ç½®é™æ€é‚»å±…æ¡ç›®ï¼ˆå…³é”®è·¯å¾„ï¼‰
```

---

## 6. ğŸ›£ï¸ IPv6è·¯ç”±é…ç½®ä¸ç®¡ç†


### 6.1 IPv6è·¯ç”±åŸºç¡€æ¦‚å¿µ


**IPv6è·¯ç”± vs IPv4è·¯ç”±çš„åŒºåˆ«**
> IPv6è·¯ç”±å°±åƒå‡çº§ç‰ˆçš„"äº¤é€šå¯¼èˆªç³»ç»Ÿ"ï¼Œä¸ä»…é“è·¯æ›´å®½ï¼ˆ128ä½åœ°å€ï¼‰ï¼Œè·¯æ ‡æ›´æ¸…æ™°ï¼ˆåˆ†å±‚åœ°å€ï¼‰ï¼Œè€Œä¸”æœ‰æ›´æ™ºèƒ½çš„è·¯å¾„å‘ç°æœºåˆ¶ã€‚

```
ä¸»è¦å·®å¼‚å¯¹æ¯”ï¼š

åœ°å€é•¿åº¦ï¼š
IPv4ï¼š32ä½ï¼Œéœ€è¦ç²¾å¿ƒè§„åˆ’é¿å…æµªè´¹
IPv6ï¼š128ä½ï¼Œåœ°å€å……è¶³ï¼Œå¯ä»¥æŒ‰å±‚æ¬¡åˆ†é…

è·¯ç”±è¡¨è§„æ¨¡ï¼š
IPv4ï¼šäº’è”ç½‘è·¯ç”±è¡¨çº¦80ä¸‡æ¡è·¯ç”±
IPv6ï¼šç”±äºåˆ†å±‚åœ°å€ï¼Œè·¯ç”±è¡¨æ›´å°æ›´é«˜æ•ˆ

è·¯ç”±åè®®ï¼š
IPv4ï¼šRIPv2, OSPF, BGP-4
IPv6ï¼šRIPng, OSPFv3, BGP-4+ (æ”¯æŒIPv6)

é»˜è®¤è¡Œä¸ºï¼š
IPv4ï¼šéœ€è¦æ‰‹åŠ¨é…ç½®æˆ–DHCP
IPv6ï¼šæ”¯æŒè‡ªåŠ¨é…ç½®é»˜è®¤è·¯ç”±ï¼ˆé€šè¿‡RAï¼‰
```

### 6.2 IPv6è·¯ç”±è¡¨ç»“æ„


#### ğŸ”¸ è·¯ç”±è¡¨ç»„æˆ

```bash
# æŸ¥çœ‹IPv6è·¯ç”±è¡¨
ip -6 route show

# å…¸å‹è¾“å‡ºè§£æï¼š
::1 dev lo proto kernel metric 256 pref medium
# å›ç¯è·¯ç”±ï¼š::1é€šè¿‡loæ¥å£ï¼Œå†…æ ¸åè®®ç”Ÿæˆ

2001:db8:1000:10::/64 dev eth0 proto kernel metric 256 pref medium  
# ç›´è¿ç½‘ç»œï¼šæœ¬åœ°å­ç½‘é€šè¿‡eth0æ¥å£

fe80::/64 dev eth0 proto kernel metric 256 pref medium
# é“¾è·¯æœ¬åœ°ç½‘ç»œï¼šé€šè¿‡eth0æ¥å£

default via 2001:db8:1000:10::1 dev eth0 proto ra metric 1024 pref medium
# é»˜è®¤è·¯ç”±ï¼šé€šè¿‡ç½‘å…³2001:db8:1000:10::1ï¼ŒRAåè®®å­¦ä¹ 
```

#### ğŸ”¸ è·¯ç”±è¡¨å­—æ®µå«ä¹‰

| **å­—æ®µ** | **å«ä¹‰** | **ç¤ºä¾‹å€¼** | **è¯´æ˜** |
|---------|---------|-----------|----------|
| **ç›®æ ‡ç½‘ç»œ** | è·¯ç”±ç›®æ ‡å‰ç¼€ | `2001:db8::/32` | IPv6ç½‘ç»œåœ°å€å’Œå‰ç¼€é•¿åº¦ |
| **dev** | å‡ºæ¥å£ | `eth0` | æ•°æ®åŒ…å‘é€æ¥å£ |
| **via** | ä¸‹ä¸€è·³ | `2001:db8::1` | ä¸‹ä¸€è·³IPv6åœ°å€ |
| **proto** | åè®®æ¥æº | `kernel/ra/static` | è·¯ç”±å­¦ä¹ æ¥æº |
| **metric** | è·¯ç”±å¼€é”€ | `1024` | è·¯ç”±ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°è¶Šä¼˜å…ˆ |
| **pref** | åå¥½åº¦ | `medium/high/low` | è·¯ç”±åå¥½ç­‰çº§ |

### 6.3 é™æ€è·¯ç”±é…ç½®


#### ğŸ”¸ åŸºæœ¬é™æ€è·¯ç”±

```bash
# æ·»åŠ ä¸»æœºè·¯ç”±ï¼ˆ/128ï¼‰
ip -6 route add 2001:db8:2000::100/128 via 2001:db8:1000:10::1 dev eth0

# æ·»åŠ ç½‘ç»œè·¯ç”±
ip -6 route add 2001:db8:2000::/48 via 2001:db8:1000:10::1 dev eth0

# æ·»åŠ é»˜è®¤è·¯ç”±
ip -6 route add default via 2001:db8:1000:10::1 dev eth0

# åˆ é™¤è·¯ç”±
ip -6 route del 2001:db8:2000::/48 via 2001:db8:1000:10::1

# æ›¿æ¢è·¯ç”±
ip -6 route replace default via 2001:db8:1000:10::2 dev eth0
```

#### ğŸ”¸ å¤šè·¯å¾„å’Œè´Ÿè½½å‡è¡¡

```bash
# é…ç½®å¤šè·¯å¾„è·¯ç”±ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
ip -6 route add 2001:db8:2000::/48 \
    nexthop via 2001:db8:1000:10::1 dev eth0 weight 2 \
    nexthop via 2001:db8:1000:10::2 dev eth0 weight 1

# é…ç½®å¤‡ä»½è·¯ç”±ï¼ˆä¸åŒmetricï¼‰
ip -6 route add 2001:db8:3000::/48 via 2001:db8:1000:10::1 dev eth0 metric 100
ip -6 route add 2001:db8:3000::/48 via 2001:db8:1000:10::2 dev eth0 metric 200

# æŸ¥çœ‹å…·ä½“è·¯ç”±
ip -6 route get 2001:db8:2000::1
# æ˜¾ç¤ºåˆ°è¾¾ç›®æ ‡çš„å…·ä½“è·¯å¾„é€‰æ‹©
```

#### ğŸ”¸ æ°¸ä¹…é™æ€è·¯ç”±é…ç½®

**Netplané…ç½®ï¼š**
```yaml
# /etc/netplan/01-netcfg.yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      addresses:
        - 2001:db8:1000:10::100/64
      gateway6: 2001:db8:1000:10::1
      routes:
        - to: 2001:db8:2000::/48
          via: 2001:db8:1000:10::1
        - to: 2001:db8:3000::/48  
          via: 2001:db8:1000:10::2
          metric: 200
```

**CentOS/RHELé™æ€è·¯ç”±ï¼š**
```bash
# /etc/sysconfig/network-scripts/route6-eth0
2001:db8:2000::/48 via 2001:db8:1000:10::1 dev eth0
2001:db8:3000::/48 via 2001:db8:1000:10::2 dev eth0 metric 200

# é‡å¯ç½‘ç»œæœåŠ¡åº”ç”¨é…ç½®
systemctl restart network
```

### 6.4 åŠ¨æ€è·¯ç”±åè®®


#### ğŸ”¸ RIPngé…ç½®


**ä»€ä¹ˆæ˜¯RIPngï¼Ÿ**
> RIPngæ˜¯RIPåè®®çš„IPv6ç‰ˆæœ¬ï¼Œå°±åƒ"è€å¸æœºå¸¦æ–°è·¯"ï¼Œé€‚åˆå°å‹ç½‘ç»œçš„ç®€å•è·¯ç”±å­¦ä¹ ï¼Œä½†æœ‰15è·³çš„é™åˆ¶ã€‚

```bash
# å®‰è£…Quagga/FRRè½¯ä»¶åŒ…
sudo apt install frr

# å¯ç”¨RIPng
# /etc/frr/daemons
ripngd=yes

# é…ç½®RIPng
# /etc/frr/ripngd.conf
hostname R1
password zebra
enable password zebra

router ripng
  network eth0
  network eth1
  redistribute static
  redistribute connected

# é‡å¯æœåŠ¡
systemctl restart frr
```

**RIPngè·¯ç”±è¡¨ç›‘æ§ï¼š**
```bash
# è¿›å…¥FRRé…ç½®æ¨¡å¼
vtysh

# æŸ¥çœ‹RIPngè·¯ç”±
show ipv6 ripng status
show ipv6 ripng database
show ipv6 route ripng

# è°ƒè¯•RIPng
debug ripng events
debug ripng packet
```

#### ğŸ”¸ OSPFv3é…ç½®


**OSPFv3 vs OSPFv2å·®å¼‚ï¼š**
```
ä¸»è¦å˜åŒ–ï¼š
â€¢ åŸºäºé“¾è·¯è€Œéå­ç½‘è¿è¡Œ
â€¢ ä½¿ç”¨é“¾è·¯æœ¬åœ°åœ°å€å»ºç«‹é‚»æ¥å…³ç³»
â€¢ åœ°å€ä¿¡æ¯å’Œæ‹“æ‰‘ä¿¡æ¯åˆ†ç¦»
â€¢ æ”¯æŒå¤šä¸ªåœ°å€æ—ï¼ˆIPv4å’ŒIPv6ï¼‰
```

**åŸºç¡€OSPFv3é…ç½®ï¼š**
```bash
# /etc/frr/ospf6d.conf
hostname R1
password zebra

interface eth0
  ipv6 ospf6 area 0.0.0.0
  ipv6 ospf6 hello-interval 10
  ipv6 ospf6 dead-interval 40

interface eth1  
  ipv6 ospf6 area 0.0.0.1

router ospf6
  router-id 1.1.1.1
  area 0.0.0.0 range 2001:db8:1000::/48
  redistribute static
```

**OSPFv3ç›‘æ§å’Œè°ƒè¯•ï¼š**
```bash
# OSPFv3çŠ¶æ€æŸ¥çœ‹
show ipv6 ospf6 neighbor
show ipv6 ospf6 database  
show ipv6 ospf6 route
show ipv6 ospf6 interface

# OSPFv3è°ƒè¯•
debug ospf6 hello
debug ospf6 lsa
debug ospf6 route
```

### 6.5 ç­–ç•¥è·¯ç”±é…ç½®


#### ğŸ”¸ åŸºäºæºåœ°å€çš„è·¯ç”±

```bash
# åˆ›å»ºè·¯ç”±è¡¨
echo "100 user_table" >> /etc/iproute2/rt_tables
echo "200 server_table" >> /etc/iproute2/rt_tables

# åœ¨æŒ‡å®šè¡¨ä¸­æ·»åŠ è·¯ç”±
ip -6 route add default via 2001:db8:1000:10::1 dev eth0 table user_table
ip -6 route add default via 2001:db8:1000:10::2 dev eth0 table server_table

# åˆ›å»ºç­–ç•¥è§„åˆ™
ip -6 rule add from 2001:db8:1000:10::/64 table user_table prio 100
ip -6 rule add from 2001:db8:1000:2::/64 table server_table prio 200

# æŸ¥çœ‹ç­–ç•¥è§„åˆ™
ip -6 rule show
```

#### ğŸ”¸ åŸºäºæ¥å£å’ŒæœåŠ¡çš„è·¯ç”±

```bash
# åŸºäºæ ‡è®°çš„ç­–ç•¥è·¯ç”±
iptables -t mangle -A OUTPUT -p tcp --dport 80 -j MARK --set-mark 1
ip -6 rule add fwmark 1 table web_table prio 150

# åŸºäºåº”ç”¨çš„è·¯ç”±
ip -6 rule add sport 22 table management_table prio 50
ip -6 rule add sport 53 table dns_table prio 60
```

### 6.6 IPv6è·¯ç”±ä¼˜åŒ–


#### ğŸ”¸ è·¯ç”±ç¼“å­˜å’Œæ€§èƒ½

```bash
# æŸ¥çœ‹IPv6è·¯ç”±ç¼“å­˜ç»Ÿè®¡
cat /proc/net/rt6_stats

# è°ƒæ•´è·¯ç”±ç¼“å­˜å‚æ•°
echo 8192 > /proc/sys/net/ipv6/route/max_size        # æœ€å¤§è·¯ç”±æ¡ç›®æ•°
echo 300 > /proc/sys/net/ipv6/route/gc_timeout       # åƒåœ¾å›æ”¶è¶…æ—¶
echo 60 > /proc/sys/net/ipv6/route/gc_interval       # åƒåœ¾å›æ”¶é—´éš”

# ç¦ç”¨IPv6è½¬å‘æ—¶çš„è·¯ç”±ç¼“å­˜ä¼˜åŒ–
echo 0 > /proc/sys/net/ipv6/conf/all/forwarding
```

#### ğŸ”¸ è·¯ç”±èšåˆç­–ç•¥

```bash
# æ‰‹åŠ¨è·¯ç”±èšåˆé…ç½®
# å°†å¤šä¸ªå­ç½‘èšåˆä¸ºä¸€ä¸ªè·¯ç”±
ip -6 route add 2001:db8:1000::/48 via 2001:db8:1000:10::1

# åˆ é™¤å…·ä½“å­ç½‘è·¯ç”±ï¼ˆç”±èšåˆè·¯ç”±è¦†ç›–ï¼‰
ip -6 route del 2001:db8:1000:10::/64 via 2001:db8:1000:10::1
ip -6 route del 2001:db8:1000:20::/64 via 2001:db8:1000:10::1
```

### 6.7 è·¯ç”±æ•…éšœè¯Šæ–­


#### ğŸ”¸ è·¯ç”±è¿é€šæ€§æµ‹è¯•

```bash
# åŸºæœ¬è¿é€šæ€§æµ‹è¯•
ping6 2001:db8:2000::1
ping6 google.com

# è·¯ç”±è·Ÿè¸ª
traceroute6 2001:db8:2000::1
# æˆ–è€…
tracepath6 2001:db8:2000::1

# æŒ‡å®šæºåœ°å€çš„æµ‹è¯•
ping6 -I 2001:db8:1000:10::100 google.com
```

#### ğŸ”¸ è·¯ç”±è¡¨åˆ†æ

```bash
# è¯¦ç»†è·¯ç”±ä¿¡æ¯
ip -6 route get 2001:db8:2000::1
# æ˜¾ç¤ºåˆ°è¾¾ç›®æ ‡çš„å®Œæ•´è·¯å¾„ä¿¡æ¯

# ç›‘æ§è·¯ç”±å˜åŒ–
ip -6 monitor route
# å®æ—¶æ˜¾ç¤ºè·¯ç”±è¡¨å˜åŒ–

# æ¯”è¾ƒä¸åŒè¡¨çš„è·¯ç”±
ip -6 route show table main
ip -6 route show table user_table
ip -6 route show table all
```

**å¸¸è§è·¯ç”±é—®é¢˜è¯Šæ–­ï¼š**

**é—®é¢˜1ï¼šé»˜è®¤è·¯ç”±ç¼ºå¤±**
```bash
# æ£€æŸ¥é»˜è®¤è·¯ç”±
ip -6 route | grep default

# æ‰‹åŠ¨æ·»åŠ é»˜è®¤è·¯ç”±
ip -6 route add default via fe80::1 dev eth0

# æ°¸ä¹…è§£å†³ï¼šæ£€æŸ¥RAé…ç½®æˆ–é™æ€é…ç½®
```

**é—®é¢˜2ï¼šè·¯ç”±ç¯è·¯**
```bash
# æ£€æŸ¥è·¯ç”±ç¯è·¯
traceroute6 ç›®æ ‡åœ°å€
# çœ‹æ˜¯å¦å‡ºç°é‡å¤çš„è·³æ•°

# æ£€æŸ¥è·¯ç”±è¡¨ä¸€è‡´æ€§
ip -6 route show | grep ç›®æ ‡ç½‘ç»œ
# ç¡®ä¿æ²¡æœ‰å†²çªçš„è·¯ç”±æ¡ç›®
```

**é—®é¢˜3ï¼šå¤šè·¯å¾„è´Ÿè½½ä¸å‡è¡¡**
```bash
# æ£€æŸ¥å¤šè·¯å¾„é…ç½®
ip -6 route show | grep nexthop

# è°ƒæ•´æƒé‡
ip -6 route replace 2001:db8:2000::/48 \
    nexthop via 2001:db8:1000:10::1 dev eth0 weight 1 \
    nexthop via 2001:db8:1000:10::2 dev eth0 weight 3
```

---

## 7. ğŸŒ IPv6 DNSé…ç½®


### 7.1 IPv6 DNSåŸºç¡€æ¦‚å¿µ


**IPv6 DNSçš„ç‰¹ç‚¹**
> IPv6 DNSå°±åƒç»™"ç”µè¯ç°¿"å¢åŠ äº†æ–°çš„å·ç æ ¼å¼ï¼Œä¸ä»…è¦å­˜å‚¨ä¼ ç»Ÿçš„Aè®°å½•ï¼ˆIPv4åœ°å€ï¼‰ï¼Œè¿˜è¦å­˜å‚¨AAAAè®°å½•ï¼ˆIPv6åœ°å€ï¼‰ï¼Œè®©åŸŸåèƒ½åŒæ—¶å¯¹åº”ä¸¤ç§åœ°å€ã€‚

```
DNSè®°å½•ç±»å‹å¯¹æ¯”ï¼š

IPv4ç¯å¢ƒï¼š
Aè®°å½•ï¼š    example.com â†’ 192.168.1.100
MXè®°å½•ï¼š   example.com â†’ mail.example.com â†’ 192.168.1.25  
CNAMEè®°å½•ï¼šwww.example.com â†’ example.com

IPv6ç¯å¢ƒï¼š
AAAAè®°å½•ï¼š example.com â†’ 2001:db8:1000::100
Aè®°å½•ï¼š    example.com â†’ 192.168.1.100      # åŒæ ˆ
MXè®°å½•ï¼š   example.com â†’ mail.example.com â†’ AAAA â†’ 2001:db8:1000::25
PTRè®°å½•ï¼š  IPv6åå‘è§£æ â†’ domain.example.com
```

### 7.2 å®¢æˆ·ç«¯DNSé…ç½®


#### ğŸ”¸ åŸºç¡€DNSå®¢æˆ·ç«¯é…ç½®

```bash
# æŸ¥çœ‹å½“å‰DNSé…ç½®
cat /etc/resolv.conf

# IPv6 DNSæœåŠ¡å™¨ç¤ºä¾‹é…ç½®
# /etc/resolv.conf
nameserver 2001:4860:4860::8888    # Google DNS IPv6
nameserver 2001:4860:4860::8844    # Googleå¤‡ç”¨DNS IPv6
nameserver 8.8.8.8                 # Google DNS IPv4ï¼ˆå¤‡ç”¨ï¼‰
search example.com localdomain

# æµ‹è¯•IPv6 DNSè§£æ
nslookup google.com 2001:4860:4860::8888
dig @2001:4860:4860::8888 google.com AAAA
```

#### ğŸ”¸ systemd-resolvedé…ç½®

```bash
# ç°ä»£Linuxå‘è¡Œç‰ˆä½¿ç”¨systemd-resolved
# /etc/systemd/resolved.conf
[Resolve]
DNS=2001:4860:4860::8888 2001:4860:4860::8844 8.8.8.8
FallbackDNS=2001:db8:1000::53 192.168.1.53
Domains=example.com
LLMNR=yes
MulticastDNS=yes
DNSSEC=allow-downgrade
DNSOverTLS=opportunistic

# é‡å¯æœåŠ¡
systemctl restart systemd-resolved

# æŸ¥çœ‹DNSçŠ¶æ€
resolvectl status
```

#### ğŸ”¸ NetworkManager DNSé…ç½®

```bash
# é€šè¿‡NetworkManageré…ç½®IPv6 DNS
nmcli con mod eth0 ipv6.dns "2001:4860:4860::8888,2001:4860:4860::8844"
nmcli con mod eth0 ipv6.dns-search "example.com,localdomain"  
nmcli con up eth0

# æŸ¥çœ‹è¿æ¥çš„DNSé…ç½®
nmcli con show eth0 | grep dns
```

### 7.3 BIND9 IPv6é…ç½®


#### ğŸ”¸ åŸºç¡€BIND9 IPv6é…ç½®

```
# /etc/bind/named.conf.options
options {
    directory "/var/cache/bind";
    
    # åŒæ—¶ç›‘å¬IPv4å’ŒIPv6
    listen-on { any; };
    listen-on-v6 { any; };
    
    # IPv6æŸ¥è¯¢æºåœ°å€
    query-source-v6 address * port *;
    
    # å…è®¸é€’å½’æŸ¥è¯¢çš„ç½‘ç»œï¼ˆåŒæ ˆï¼‰
    allow-recursion {
        192.168.0.0/16;       # IPv4å†…ç½‘
        10.0.0.0/8;           # IPv4å†…ç½‘
        2001:db8::/32;        # IPv6å†…ç½‘
        ::1;                  # IPv6å›ç¯
    };
    
    # è½¬å‘å™¨é…ç½®ï¼ˆåŒæ ˆï¼‰
    forwarders {
        8.8.8.8;
        8.8.4.4;
        2001:4860:4860::8888;
        2001:4860:4860::8844;
    };
    
    # DNSSECé…ç½®
    dnssec-enable yes;
    dnssec-validation auto;
};
```

#### ğŸ”¸ æ­£å‘è§£æåŒºåŸŸé…ç½®

```
# /etc/bind/named.conf.local
zone "example.com" {
    type master;
    file "/etc/bind/db.example.com";
    allow-transfer { 2001:db8:1000::54; 192.168.1.54; };  # åŒæ ˆä»æœåŠ¡å™¨
};

# åŒºåŸŸæ–‡ä»¶ /etc/bind/db.example.com
$TTL    604800
@       IN      SOA     ns1.example.com. admin.example.com. (
                              2024091901 ; Serial (YYYYMMDDNN)
                         604800         ; Refresh (1 week)
                          86400         ; Retry (1 day)
                        2419200         ; Expire (4 weeks)
                         604800 )       ; Negative Cache TTL (1 week)

; åç§°æœåŠ¡å™¨è®°å½•ï¼ˆåŒæ ˆï¼‰
@       IN      NS      ns1.example.com.
@       IN      NS      ns2.example.com.

; ä¸»æœºè®°å½•ï¼ˆåŒæ ˆï¼‰
ns1     IN      A       192.168.1.53
ns1     IN      AAAA    2001:db8:1000::53
ns2     IN      A       192.168.1.54  
ns2     IN      AAAA    2001:db8:1000::54

; WebæœåŠ¡å™¨ï¼ˆåŒæ ˆï¼‰
@       IN      A       192.168.1.80
@       IN      AAAA    2001:db8:1000::80
www     IN      CNAME   @

; é‚®ä»¶æœåŠ¡å™¨
@       IN      MX      10 mail.example.com.
mail    IN      A       192.168.1.25
mail    IN      AAAA    2001:db8:1000::25

; å…¶ä»–æœåŠ¡
ftp     IN      A       192.168.1.21
ftp     IN      AAAA    2001:db8:1000::21
ssh     IN      A       192.168.1.22
ssh     IN      AAAA    2001:db8:1000::22
```

#### ğŸ”¸ IPv6åå‘è§£æé…ç½®

```
# IPv6åå‘è§£æåŒºåŸŸé…ç½®
# /etc/bind/named.conf.local
zone "0.0.0.1.8.b.d.0.1.0.0.2.ip6.arpa" {
    type master;
    file "/etc/bind/db.2001:db8:1000";
};

# åå‘è§£æåŒºåŸŸæ–‡ä»¶
# /etc/bind/db.2001:db8:1000
$TTL    604800
@       IN      SOA     ns1.example.com. admin.example.com. (
                              2024091901 ; Serial
                         604800         ; Refresh
                          86400         ; Retry  
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL

@       IN      NS      ns1.example.com.
@       IN      NS      ns2.example.com.

; PTRè®°å½•ï¼ˆIPv6åœ°å€å€’åºï¼‰
; 2001:db8:1000::53 â†’ 3.5.0.0.0.0.0.0.0.0.0.0.0.0.0.0
3.5.0.0.0.0.0.0.0.0.0.0.0.0.0.0 IN PTR ns1.example.com.
4.5.0.0.0.0.0.0.0.0.0.0.0.0.0.0 IN PTR ns2.example.com.
0.8.0.0.0.0.0.0.0.0.0.0.0.0.0.0 IN PTR www.example.com.
5.2.0.0.0.0.0.0.0.0.0.0.0.0.0.0 IN PTR mail.example.com.
```

### 7.4 DHCPv6ä¸­çš„DNSé…ç½®


#### ğŸ”¸ DHCPv6æœåŠ¡å™¨DNSé…ç½®

```
# /etc/dhcp/dhcpd6.conf
authoritative;
ddns-update-style none;

# å…¨å±€DNSé€‰é¡¹
option dhcp6.name-servers 2001:db8:1000::53, 2001:db8:1000::54;
option dhcp6.domain-search "example.com", "localdomain";

# å­ç½‘é…ç½®
subnet6 2001:db8:1000:10::/64 {
    # åœ°å€èŒƒå›´
    range6 2001:db8:1000:10::1000 2001:db8:1000:10::2000;
    
    # DNSæœåŠ¡å™¨
    option dhcp6.name-servers 2001:db8:1000::53;
    
    # åŸŸåæœç´¢åˆ—è¡¨
    option dhcp6.domain-search "example.com";
}

# å›ºå®šåœ°å€åˆ†é…  
host server1 {
    host-identifier option dhcp6.client-id 00:01:00:01:12:34:56:78:aa:bb:cc:dd:ee:ff;
    fixed-address6 2001:db8:1000:10::100;
}
```

#### ğŸ”¸ å®¢æˆ·ç«¯DHCPv6é…ç½®

```bash
# Ubuntu/Debian DHCPv6å®¢æˆ·ç«¯
# /etc/dhcp/dhclient6.conf
send dhcp6.client-id = concat(00:01, hardware);
request dhcp6.name-servers, dhcp6.domain-search;

# å¯åŠ¨DHCPv6å®¢æˆ·ç«¯
dhclient -6 eth0

# æŸ¥çœ‹è·å–çš„é…ç½®
cat /var/lib/dhcp/dhclient6.leases
```

### 7.5 DNS64/NAT64é…ç½®


#### ğŸ”¸ DNS64åŸºç¡€æ¦‚å¿µ

**ä»€ä¹ˆæ˜¯DNS64ï¼Ÿ**
> DNS64å°±åƒ"ç¿»è¯‘å®˜"ï¼Œå½“IPv6å®¢æˆ·ç«¯è¦è®¿é—®åªæœ‰IPv4åœ°å€çš„æœåŠ¡å™¨æ—¶ï¼ŒDNS64æŠŠIPv4åœ°å€"ç¿»è¯‘"æˆç‰¹æ®Šçš„IPv6åœ°å€ï¼Œè®©çº¯IPv6ç¯å¢ƒä¹Ÿèƒ½è®¿é—®IPv4èµ„æºã€‚

```
DNS64å·¥ä½œæµç¨‹ï¼š
1. IPv6å®¢æˆ·ç«¯æŸ¥è¯¢www.ipv4only.comçš„AAAAè®°å½•
2. DNS64æœåŠ¡å™¨å‘ç°æ²¡æœ‰AAAAè®°å½•ï¼Œä½†æœ‰Aè®°å½•(192.0.2.1)  
3. DNS64å°†IPv4åœ°å€åµŒå…¥åˆ°IPv6å‰ç¼€ä¸­
4. è¿”å›åˆæˆçš„AAAAè®°å½•ï¼š64:ff9b::192.0.2.1
5. å®¢æˆ·ç«¯å‘è¿™ä¸ªIPv6åœ°å€å‘é€æ•°æ®åŒ…
6. NAT64ç½‘å…³å°†æµé‡è½¬æ¢ä¸ºIPv4å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨
```

#### ğŸ”¸ BIND9 DNS64é…ç½®

```
# /etc/bind/named.conf.options  
options {
    listen-on-v6 { any; };
    
    # å¯ç”¨DNS64åŠŸèƒ½
    dns64 64:ff9b::/96 {
        clients { any; };
        mapped { !192.168.0.0/16; !10.0.0.0/8; any; };
        exclude { 64:ff9b::/96; ::ffff:0.0.0.0/96; };
        suffix ::;
    };
    
    # å…¶ä»–é…ç½®...
};

# éªŒè¯DNS64åŠŸèƒ½
dig @::1 www.example-ipv4-only.com AAAA
# åº”è¯¥è¿”å›ç±»ä¼¼64:ff9b::c000:201çš„åˆæˆIPv6åœ°å€
```

### 7.6 DNSå®‰å…¨é…ç½®


#### ğŸ”¸ DNSSEC IPv6é…ç½®

```bash
# ç”ŸæˆåŒºåŸŸç­¾åå¯†é’¥
cd /etc/bind/keys
dnssec-keygen -r /dev/urandom -a RSASHA256 -b 2048 -n ZONE example.com
dnssec-keygen -r /dev/urandom -a RSASHA256 -b 4096 -f KSK -n ZONE example.com

# ç­¾ååŒºåŸŸæ–‡ä»¶
dnssec-signzone -A -3 $(head -c 1000 /dev/urandom | sha1sum | cut -b 1-16) \
                -N INCREMENT -o example.com \
                -t /etc/bind/db.example.com

# BIND9 DNSSECé…ç½®
# /etc/bind/named.conf.options
options {
    dnssec-enable yes;
    dnssec-validation auto;
    dnssec-lookaside auto;
};

# åŒ…å«ç­¾ååçš„åŒºåŸŸæ–‡ä»¶
# /etc/bind/named.conf.local  
zone "example.com" {
    type master;
    file "/etc/bind/db.example.com.signed";
    key-directory "/etc/bind/keys";
    auto-dnssec maintain;
};
```

#### ğŸ”¸ DNS over HTTPS/TLSé…ç½®

```
# ä½¿ç”¨Unboundé…ç½®DoT
# /etc/unbound/unbound.conf
server:
    # åŸºæœ¬é…ç½®
    interface: ::0
    port: 853
    do-ip6: yes
    
    # TLSé…ç½®
    tls-service-key: "/etc/unbound/unbound_server.key"
    tls-service-pem: "/etc/unbound/unbound_server.pem"
    tls-port: 853
    
    # è®¿é—®æ§åˆ¶
    access-control: 2001:db8::/32 allow
    access-control: ::1 allow

# å®¢æˆ·ç«¯DoTé…ç½®
# /etc/systemd/resolved.conf
[Resolve]
DNS=2001:db8:1000::53#dns.example.com
DNSOverTLS=yes
```

### 7.7 DNSæ•…éšœè¯Šæ–­


#### ğŸ”¸ DNSæŸ¥è¯¢æµ‹è¯•å·¥å…·

```bash
# åŸºç¡€æŸ¥è¯¢æµ‹è¯•
dig google.com A                    # IPv4æŸ¥è¯¢
dig google.com AAAA                 # IPv6æŸ¥è¯¢  
dig @2001:4860:4860::8888 google.com AAAA    # æŒ‡å®šIPv6 DNSæœåŠ¡å™¨

# åå‘DNSæŸ¥è¯¢
dig -x 2001:4860:4860::8888        # IPv6åå‘æŸ¥è¯¢
dig -x 8.8.8.8                     # IPv4åå‘æŸ¥è¯¢

# è¯¦ç»†æŸ¥è¯¢ä¿¡æ¯
dig +trace google.com AAAA          # è·Ÿè¸ªæŸ¥è¯¢è·¯å¾„
dig +short google.com AAAA          # ç®€çŸ­è¾“å‡º
dig +noall +answer google.com AAAA  # åªæ˜¾ç¤ºç­”æ¡ˆ
```

#### ğŸ”¸ DNSæœåŠ¡å™¨ç›‘æ§

```bash
# æ£€æŸ¥BIND9æœåŠ¡çŠ¶æ€
systemctl status bind9
journalctl -u bind9 -f

# ç›‘æ§DNSæŸ¥è¯¢æ—¥å¿—
tail -f /var/log/syslog | grep named

# ç»Ÿè®¡æŸ¥è¯¢ç±»å‹
grep "query:" /var/log/syslog | grep "A " | wc -l     # IPv4æŸ¥è¯¢æ•°
grep "query:" /var/log/syslog | grep "AAAA " | wc -l  # IPv6æŸ¥è¯¢æ•°

# æ£€æŸ¥åŒºåŸŸæ–‡ä»¶è¯­æ³•
named-checkzone example.com /etc/bind/db.example.com
named-checkconf /etc/bind/named.conf
```

**DNSæ•…éšœè¯Šæ–­æ¸…å•ï¼š**
```
ğŸ” å®¢æˆ·ç«¯é—®é¢˜ï¼š
â–¡ /etc/resolv.confé…ç½®æ­£ç¡®
â–¡ IPv6 DNSæœåŠ¡å™¨å¯è¾¾
â–¡ ç½‘ç»œè¿é€šæ€§æ­£å¸¸
â–¡ é˜²ç«å¢™å…è®¸DNSæµé‡

ğŸ” æœåŠ¡å™¨é—®é¢˜ï¼š  
â–¡ æœåŠ¡è¿›ç¨‹æ­£åœ¨è¿è¡Œ
â–¡ ç›‘å¬æ­£ç¡®çš„IPv6åœ°å€
â–¡ åŒºåŸŸæ–‡ä»¶è¯­æ³•æ­£ç¡®
â–¡ æƒé™è®¾ç½®æ­£ç¡®

ğŸ” ç½‘ç»œé—®é¢˜ï¼š
â–¡ IPv6è¿é€šæ€§æµ‹è¯•
â–¡ é˜²ç«å¢™è§„åˆ™æ£€æŸ¥  
â–¡ è·¯ç”±é…ç½®éªŒè¯
â–¡ ç«¯å£53å¯è®¿é—®æ€§æµ‹è¯•

ğŸ” è§£æé—®é¢˜ï¼š
â–¡ æ­£å‘è§£ææµ‹è¯•
â–¡ åå‘è§£ææµ‹è¯•
â–¡ DNSSECéªŒè¯
â–¡ é€’å½’æŸ¥è¯¢åŠŸèƒ½
```

---

## 8. ğŸ”§ IPv6è¿é€šæ€§æµ‹è¯•


### 8.1 åŸºç¡€è¿é€šæ€§æµ‹è¯•


**IPv6è¿é€šæ€§æµ‹è¯•çš„é‡è¦æ€§**
> IPv6è¿é€šæ€§æµ‹è¯•å°±åƒ"ç½‘ç»œå¥åº·ä½“æ£€"ï¼Œä¸ä»…è¦æ£€æŸ¥èƒ½å¦åˆ°è¾¾ç›®æ ‡ï¼Œè¿˜è¦æ£€æŸ¥è·¯å¾„æ˜¯å¦æœ€ä¼˜ã€å»¶è¿Ÿæ˜¯å¦æ­£å¸¸ã€åŠŸèƒ½æ˜¯å¦å®Œæ•´ã€‚

#### ğŸ”¸ ping6åŸºç¡€æµ‹è¯•

```bash
# åŸºæœ¬è¿é€šæ€§æµ‹è¯•  
ping6 ::1                           # æµ‹è¯•æœ¬æœºIPv6æ ˆ
ping6 fe80::1%eth0                 # æµ‹è¯•é“¾è·¯æœ¬åœ°ç½‘å…³  
ping6 2001:db8:1000::1            # æµ‹è¯•æœ¬åœ°ç½‘å…³
ping6 2001:4860:4860::8888        # æµ‹è¯•å…¬ç½‘DNS
ping6 google.com                   # æµ‹è¯•åŸŸåè§£æ

# é«˜çº§ping6é€‰é¡¹
ping6 -c 10 -i 0.5 -s 1400 google.com
# -c 10ï¼šå‘é€10ä¸ªåŒ…
# -i 0.5ï¼šé—´éš”0.5ç§’  
# -s 1400ï¼šåŒ…å¤§å°1400å­—èŠ‚ï¼ˆæµ‹è¯•MTUï¼‰

# æŒ‡å®šæºåœ°å€
ping6 -I 2001:db8:1000::100 google.com
ping6 -I eth0 google.com           # æŒ‡å®šæ¥å£
```

#### ğŸ”¸ è¿é€šæ€§æµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# ipv6_connectivity_test.sh

echo "=== IPv6è¿é€šæ€§æµ‹è¯•æŠ¥å‘Š ==="
echo "æµ‹è¯•æ—¶é—´ï¼š$(date)"
echo

# 1. æœ¬åœ°æ¥å£æµ‹è¯•
echo "1. æœ¬åœ°æ¥å£æµ‹è¯•"
if ping6 -c 1 ::1 >/dev/null 2>&1; then
    echo "âœ… IPv6æœ¬åœ°å›ç¯ï¼šæ­£å¸¸"
else
    echo "âŒ IPv6æœ¬åœ°å›ç¯ï¼šå¤±è´¥"
fi

# 2. é“¾è·¯æœ¬åœ°æµ‹è¯•
echo "2. é“¾è·¯æœ¬åœ°è¿é€šæ€§"
GATEWAY=$(ip -6 route | grep default | awk '{print $3}' | head -1)
if [ -n "$GATEWAY" ]; then
    if ping6 -c 1 "$GATEWAY" >/dev/null 2>&1; then
        echo "âœ… é»˜è®¤ç½‘å…³($GATEWAY)ï¼šæ­£å¸¸"
    else
        echo "âŒ é»˜è®¤ç½‘å…³($GATEWAY)ï¼šå¤±è´¥"
    fi
else
    echo "âš ï¸  æœªæ‰¾åˆ°IPv6é»˜è®¤ç½‘å…³"
fi

# 3. å…¬ç½‘è¿é€šæ€§æµ‹è¯•
echo "3. å…¬ç½‘è¿é€šæ€§æµ‹è¯•"
PUBLIC_SERVERS=("2001:4860:4860::8888" "2606:4700:4700::1111")
for server in "${PUBLIC_SERVERS[@]}"; do
    if ping6 -c 1 "$server" >/dev/null 2>&1; then
        echo "âœ… $serverï¼šæ­£å¸¸"
    else
        echo "âŒ $serverï¼šå¤±è´¥"  
    fi
done

# 4. åŸŸåè§£ææµ‹è¯•
echo "4. åŸŸåè§£ææµ‹è¯•"
if ping6 -c 1 google.com >/dev/null 2>&1; then
    echo "âœ… åŸŸåè§£æï¼šæ­£å¸¸"
else
    echo "âŒ åŸŸåè§£æï¼šå¤±è´¥"
fi

echo
echo "æµ‹è¯•å®Œæˆ"
```

### 8.2 è·¯å¾„å’Œå»¶è¿Ÿåˆ†æ


#### ğŸ”¸ traceroute6è·¯å¾„åˆ†æ

```bash
# åŸºæœ¬è·¯å¾„è·Ÿè¸ª
traceroute6 google.com

# è¯¦ç»†è·¯å¾„åˆ†æï¼ˆåŒ…å«ASå·ç ï¼‰
traceroute6 -A google.com

# æŒ‡å®šæœ€å¤§è·³æ•°
traceroute6 -m 15 google.com

# ä¸è¿›è¡ŒåŸŸååå‘è§£æï¼ˆåŠ å¿«é€Ÿåº¦ï¼‰
traceroute6 -n google.com

# ä½¿ç”¨UDPæ¢æµ‹ï¼ˆé»˜è®¤ï¼‰
traceroute6 -U -p 53 google.com

# ä½¿ç”¨ICMPæ¢æµ‹  
traceroute6 -I google.com

# ä½¿ç”¨TCPæ¢æµ‹
traceroute6 -T -p 80 google.com
```

**è·¯å¾„åˆ†æç¤ºä¾‹è¾“å‡ºï¼š**
```
traceroute to google.com (2404:6800:4008:c07::71), 30 hops max, 80 byte packets
 1  2001:db8:1000::1 (2001:db8:1000::1)  1.234 ms  1.123 ms  1.045 ms
 2  2001:db8:2000::1 (2001:db8:2000::1)  5.678 ms  5.567 ms  5.432 ms  
 3  2001:550:0:1000::1 (2001:550:0:1000::1)  12.345 ms  12.234 ms  12.123 ms
 4  * * *
 5  2404:6800:8000::1 (2404:6800:8000::1)  45.678 ms  45.567 ms  45.456 ms

åˆ†æè¦ç‚¹ï¼š
â€¢ ç¬¬1è·³ï¼šæœ¬åœ°ç½‘å…³ï¼Œå»¶è¿Ÿ<2msæ­£å¸¸
â€¢ ç¬¬2è·³ï¼šISPè¾¹ç¼˜è·¯ç”±å™¨ï¼Œå»¶è¿Ÿ<10msæ­£å¸¸  
â€¢ ç¬¬4è·³ï¼š* * * è¡¨ç¤ºè¯¥è·³ä¸å“åº”traceroute
â€¢ æœ€åä¸€è·³ï¼šåˆ°è¾¾ç›®æ ‡ï¼Œæ€»å»¶è¿Ÿ45ms
```

#### ğŸ”¸ MTUè·¯å¾„å‘ç°

```bash
# æ‰‹åŠ¨MTUæµ‹è¯•
ping6 -s 1400 -M do google.com     # 1400å­—èŠ‚ï¼Œç¦æ­¢åˆ†ç‰‡
ping6 -s 1450 -M do google.com     # 1450å­—èŠ‚æµ‹è¯•
ping6 -s 1500 -M do google.com     # 1500å­—èŠ‚æµ‹è¯•

# è‡ªåŠ¨MTUå‘ç°
tracepath6 google.com
# è¾“å‡ºåŒ…å«è·¯å¾„MTUä¿¡æ¯

# æ£€æŸ¥æ¥å£MTU
ip link show eth0 | grep mtu
```

**MTUæµ‹è¯•è„šæœ¬ï¼š**
```bash
#!/bin/bash
# mtu_discovery.sh

TARGET=${1:-google.com}
echo "æµ‹è¯•åˆ° $TARGET çš„è·¯å¾„MTU..."

for size in 1280 1400 1450 1500 1550 1600; do
    echo -n "æµ‹è¯•MTU $size å­—èŠ‚: "
    if ping6 -c 1 -s $size -M do $TARGET >/dev/null 2>&1; then
        echo "âœ… æˆåŠŸ"
        MAX_MTU=$size
    else
        echo "âŒ å¤±è´¥"
        break
    fi
done

echo "å»ºè®®MTUå¤§å°: $MAX_MTU å­—èŠ‚"
```

### 8.3 åº”ç”¨å±‚è¿é€šæ€§æµ‹è¯•


#### ğŸ”¸ HTTP/HTTPSè¿é€šæ€§

```bash
# æµ‹è¯•HTTPè¿é€šæ€§
curl -6 http://example.com
curl -6 -I http://example.com       # åªè·å–å¤´éƒ¨

# æµ‹è¯•HTTPSè¿é€šæ€§
curl -6 https://google.com
curl -6 -k https://self-signed.example.com  # å¿½ç•¥è¯ä¹¦é”™è¯¯

# æŒ‡å®šæºåœ°å€
curl --interface eth0 -6 http://example.com
curl --local-port 12345 -6 http://example.com

# è¯¦ç»†è¿æ¥ä¿¡æ¯
curl -6 -w "@curl-format.txt" http://example.com

# curl-format.txtå†…å®¹ï¼š
#      time_namelookup:  %{time_namelookup}s\n
#         time_connect:  %{time_connect}s\n  
#      time_appconnect:  %{time_appconnect}s\n
#       time_pretransfer:  %{time_pretransfer}s\n
#          time_redirect:  %{time_redirect}s\n
#     time_starttransfer:  %{time_starttransfer}s\n
#                        ----------\n
#             time_total:  %{time_total}s\n
```

#### ğŸ”¸ TCP/UDPç«¯å£æµ‹è¯•

```bash
# TCPè¿é€šæ€§æµ‹è¯•
nc -6 -v google.com 80
nc -6 -v 2001:4860:4860::8888 53

# UDPè¿é€šæ€§æµ‹è¯•  
nc -6 -u -v 2001:4860:4860::8888 53

# ç«¯å£æ‰«æ
nmap -6 -p 22,80,443 google.com
nmap -6 -sU -p 53,123 2001:4860:4860::8888

# æ‰¹é‡ç«¯å£æµ‹è¯•
for port in 22 80 443 993 995; do
    echo -n "ç«¯å£ $port: "
    if nc -6 -z -w3 google.com $port 2>/dev/null; then
        echo "âœ… å¼€æ”¾"
    else
        echo "âŒ å…³é—­"
    fi
done
```

#### ğŸ”¸ DNSè¿é€šæ€§æµ‹è¯•

```bash
# åŸºæœ¬DNSæµ‹è¯•
nslookup google.com 2001:4860:4860::8888
dig @2001:4860:4860::8888 google.com

# DNSå“åº”æ—¶é—´æµ‹è¯•
dig +stats @2001:4860:4860::8888 google.com | grep "Query time"

# DNS over IPv6æµ‹è¯•
dig @2001:4860:4860::8888 -t AAAA google.com
dig @2001:4860:4860::8888 -t A google.com

# åå‘DNSæµ‹è¯•
dig @2001:4860:4860::8888 -x 2001:4860:4860::8888
```

### 8.4 æ€§èƒ½æµ‹è¯•å·¥å…·


#### ğŸ”¸ iperf3å¸¦å®½æµ‹è¯•

```bash
# æœåŠ¡å™¨ç«¯
iperf3 -s -B ::                    # ç»‘å®šåˆ°IPv6

# å®¢æˆ·ç«¯æµ‹è¯•  
iperf3 -c server.example.com -6    # IPv6è¿æ¥
iperf3 -c 2001:db8:1000::100 -6    # æŒ‡å®šIPv6åœ°å€

# é«˜çº§æµ‹è¯•é€‰é¡¹
iperf3 -c server.example.com -6 -t 30 -P 4
# -t 30: æµ‹è¯•30ç§’
# -P 4: å¹¶è¡Œ4ä¸ªè¿æ¥

# UDPæ€§èƒ½æµ‹è¯•
iperf3 -c server.example.com -6 -u -b 100M
# -u: UDPæ¨¡å¼
# -b 100M: ç›®æ ‡å¸¦å®½100Mbps
```

#### ğŸ”¸ ç»¼åˆæ€§èƒ½ç›‘æ§

```bash
#!/bin/bash
# ipv6_performance_test.sh

TARGET="google.com"
IPV6_ADDR=$(dig +short $TARGET AAAA | head -1)

echo "=== IPv6æ€§èƒ½æµ‹è¯•æŠ¥å‘Š ==="  
echo "ç›®æ ‡: $TARGET ($IPV6_ADDR)"
echo "æµ‹è¯•æ—¶é—´: $(date)"
echo

# å»¶è¿Ÿæµ‹è¯•
echo "1. å»¶è¿Ÿæµ‹è¯•"
LATENCY=$(ping6 -c 10 $TARGET | tail -1 | awk -F'/' '{print $5}')
echo "å¹³å‡å»¶è¿Ÿ: ${LATENCY}ms"

# ä¸¢åŒ…ç‡æµ‹è¯•
PACKET_LOSS=$(ping6 -c 100 $TARGET | grep "packet loss" | awk '{print $6}')
echo "ä¸¢åŒ…ç‡: $PACKET_LOSS"

# DNSè§£ææ—¶é—´
echo "2. DNSè§£ææ€§èƒ½"
DNS_TIME=$(dig +stats $TARGET AAAA | grep "Query time" | awk '{print $4}')
echo "DNSæŸ¥è¯¢æ—¶é—´: ${DNS_TIME}ms"

# HTTPè¿æ¥æ—¶é—´
echo "3. HTTPè¿æ¥æ€§èƒ½"  
curl -6 -w "è¿æ¥æ—¶é—´: %{time_connect}s\né¦–å­—èŠ‚æ—¶é—´: %{time_starttransfer}s\næ€»æ—¶é—´: %{time_total}s\n" \
     -o /dev/null -s http://$TARGET

echo "æµ‹è¯•å®Œæˆ"
```

### 8.5 åŒæ ˆè¿é€šæ€§å¯¹æ¯”


#### ğŸ”¸ IPv4 vs IPv6æ€§èƒ½å¯¹æ¯”

```bash
#!/bin/bash
# dual_stack_comparison.sh

TARGET="google.com"

echo "=== åŒæ ˆè¿é€šæ€§å¯¹æ¯”æµ‹è¯• ==="
echo

# è·å–IPv4å’ŒIPv6åœ°å€
IPV4_ADDR=$(dig +short $TARGET A | head -1)
IPV6_ADDR=$(dig +short $TARGET AAAA | head -1)

echo "ç›®æ ‡åŸŸå: $TARGET"
echo "IPv4åœ°å€: $IPV4_ADDR"  
echo "IPv6åœ°å€: $IPV6_ADDR"
echo

# å»¶è¿Ÿå¯¹æ¯”
echo "å»¶è¿Ÿå¯¹æ¯”æµ‹è¯•:"
echo -n "IPv4å»¶è¿Ÿ: "
ping -c 5 -q $IPV4_ADDR | tail -1 | awk -F'/' '{print $5"ms"}'
echo -n "IPv6å»¶è¿Ÿ: "
ping6 -c 5 -q $IPV6_ADDR | tail -1 | awk -F'/' '{print $5"ms"}'

echo

# HTTPä¸‹è½½é€Ÿåº¦å¯¹æ¯”
echo "HTTPä¸‹è½½é€Ÿåº¦å¯¹æ¯”:"
echo -n "IPv4é€Ÿåº¦: "
curl -4 -w "%{speed_download}" -o /dev/null -s http://$TARGET | 
    awk '{printf "%.2f KB/s\n", $1/1024}'

echo -n "IPv6é€Ÿåº¦: "  
curl -6 -w "%{speed_download}" -o /dev/null -s http://$TARGET |
    awk '{printf "%.2f KB/s\n", $1/1024}'

echo

# è¿æ¥å»ºç«‹æ—¶é—´å¯¹æ¯”
echo "è¿æ¥å»ºç«‹æ—¶é—´å¯¹æ¯”:"
echo -n "IPv4è¿æ¥æ—¶é—´: "
curl -4 -w "%{time_connect}s" -o /dev/null -s http://$TARGET

echo -n "IPv6è¿æ¥æ—¶é—´: "
curl -6 -w "%{time_connect}s" -o /dev/null -s http://$TARGET
```

### 8.6 è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬


#### ğŸ”¸ æŒç»­è¿é€šæ€§ç›‘æ§

```bash
#!/bin/bash
# ipv6_monitor.sh

LOG_FILE="/var/log/ipv6_connectivity.log"
TARGETS=("google.com" "cloudflare.com" "2001:4860:4860::8888")

# æ—¥å¿—å‡½æ•°
log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') $1" | tee -a $LOG_FILE
}

# æµ‹è¯•å•ä¸ªç›®æ ‡
test_target() {
    local target=$1
    local result=""
    
    if ping6 -c 1 -W 5 $target >/dev/null 2>&1; then
        local latency=$(ping6 -c 1 $target | grep "time=" | awk -F'time=' '{print $2}' | awk '{print $1}')
        result="âœ… $target å¯è¾¾ (${latency})"
    else
        result="âŒ $target ä¸å¯è¾¾"
    fi
    
    log_message "$result"
    return $?
}

# ä¸»ç›‘æ§å¾ªç¯
main() {
    log_message "å¼€å§‹IPv6è¿é€šæ€§ç›‘æ§"
    
    while true; do
        local failed_count=0
        
        for target in "${TARGETS[@]}"; do
            if ! test_target $target; then
                ((failed_count++))
            fi
        done
        
        if [ $failed_count -gt 0 ]; then
            log_message "è­¦å‘Š: ${failed_count}ä¸ªç›®æ ‡è¿é€šæ€§å¼‚å¸¸"
            
            # å‘é€å‘Šè­¦é‚®ä»¶ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
            if command -v mail >/dev/null; then
                echo "IPv6è¿é€šæ€§ç›‘æ§æ£€æµ‹åˆ°${failed_count}ä¸ªå¼‚å¸¸" | 
                    mail -s "IPv6è¿é€šæ€§å‘Šè­¦" admin@example.com
            fi
        fi
        
        sleep 300  # 5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    done
}

# åå°è¿è¡Œ
if [ "$1" = "daemon" ]; then
    nohup $0 >/dev/null 2>&1 &
    echo "ç›‘æ§å·²å¯åŠ¨ï¼ŒPID: $!"
else
    main
fi
```

**è¿é€šæ€§æµ‹è¯•æœ€ä½³å®è·µï¼š**
```
ğŸ¯ æ—¥å¸¸æµ‹è¯•ï¼š
â€¢ å®šæœŸping6æµ‹è¯•åŸºç¡€è¿é€šæ€§
â€¢ ç›‘æ§å…³é”®æœåŠ¡çš„IPv6è®¿é—®
â€¢ å¯¹æ¯”IPv4å’ŒIPv6æ€§èƒ½å·®å¼‚

ğŸ¯ æ•…éšœè¯Šæ–­ï¼š  
â€¢ åˆ†å±‚æµ‹è¯•ï¼šæœ¬åœ°â†’ç½‘å…³â†’å…¬ç½‘â†’åº”ç”¨
â€¢ ä½¿ç”¨å¤šç§å·¥å…·éªŒè¯é—®é¢˜
â€¢ è®°å½•æµ‹è¯•ç»“æœä¾¿äºåˆ†æ

ğŸ¯ æ€§èƒ½ä¼˜åŒ–ï¼š
â€¢ ç›‘æ§å»¶è¿Ÿå’Œä¸¢åŒ…ç‡  
â€¢ æµ‹è¯•ä¸åŒMTUå¤§å°æ•ˆæœ
â€¢ æ¯”è¾ƒä¸åŒè·¯å¾„çš„æ€§èƒ½

ğŸ¯ è‡ªåŠ¨åŒ–ç›‘æ§ï¼š
â€¢ ç¼–å†™ç›‘æ§è„šæœ¬æŒç»­æ£€æŸ¥
â€¢ è®¾ç½®å‘Šè­¦æœºåˆ¶åŠæ—¶å‘ç°é—®é¢˜  
â€¢ è®°å½•å†å²æ•°æ®åˆ†æè¶‹åŠ¿
```

---

## 9. ğŸŒ‰ IPv6ä¸IPv4éš§é“æŠ€æœ¯


### 9.1 éš§é“æŠ€æœ¯åŸºç¡€æ¦‚å¿µ


**ä¸ºä»€ä¹ˆéœ€è¦éš§é“æŠ€æœ¯ï¼Ÿ**
> IPv6éš§é“å°±åƒåœ¨"è€å¼å…¬è·¯ç½‘"ä¸Šå»º"æ–°å¼é«˜æ¶æ¡¥"ï¼Œè®©IPv6æ•°æ®åŒ…èƒ½å¤Ÿç©¿è¶ŠIPv4ç½‘ç»œï¼Œå®ç°IPv6å­¤å²›ä¹‹é—´çš„è¿æ¥ï¼Œæ˜¯IPv6è¿‡æ¸¡æœŸçš„é‡è¦æŠ€æœ¯ã€‚

```
éš§é“æŠ€æœ¯åº”ç”¨åœºæ™¯ï¼š

åœºæ™¯1ï¼šIPv6å­¤å²›è¿æ¥
[IPv6ç½‘ç»œA] â†â†’ [IPv4äº’è”ç½‘] â†â†’ [IPv6ç½‘ç»œB]
         éš§é“           éš§é“

åœºæ™¯2ï¼šIPv6æœåŠ¡æä¾›  
[IPv6å®¢æˆ·ç«¯] â†â†’ [IPv4 ISP] â†â†’ [IPv6æœåŠ¡å•†]
           éš§é“        éš§é“

åœºæ™¯3ï¼šè¿‡æ¸¡æœŸç½‘ç»œ
[åŒæ ˆç½‘ç»œ] â†â†’ [IPv4ç½‘ç»œ] â†â†’ [ç›®æ ‡IPv6æœåŠ¡]
         éš§é“         éš§é“
```

### 9.2 6in4éš§é“é…ç½®


#### ğŸ”¸ 6in4éš§é“åŸç†

```
6in4éš§é“å°è£…æ ¼å¼ï¼š

åŸå§‹IPv6æ•°æ®åŒ…ï¼š
â”Œâ”€IPv6å¤´â”€â”â”Œâ”€è½½è·â”€â”
â”‚ 40å­—èŠ‚ â”‚ æ•°æ®  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜

6in4éš§é“å°è£…åï¼š
â”Œâ”€IPv4å¤´â”€â”â”Œâ”€IPv6å¤´â”€â”â”Œâ”€è½½è·â”€â”
â”‚ 20å­—èŠ‚ â”‚ 40å­—èŠ‚  â”‚ æ•°æ®  â”‚
â”‚åè®®=41 â”‚         â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
â€¢ IPv4åè®®å·ï¼š41 (IPv6-in-IPv4)
â€¢ å¢åŠ 20å­—èŠ‚å¼€é”€
â€¢ éœ€è¦å…¬ç½‘IPv4åœ°å€
â€¢ ä¸ç©¿è¶ŠNAT
```

#### ğŸ”¸ æ‰‹åŠ¨6in4éš§é“é…ç½®

```bash
# åœ¨Linuxç³»ç»Ÿé…ç½®6in4éš§é“

# 1. åŠ è½½IPv6-in-IPv4æ¨¡å—
modprobe sit

# 2. åˆ›å»ºéš§é“æ¥å£
ip tunnel add sit1 mode sit remote 203.0.113.10 local 192.0.2.10
ip link set sit1 up

# 3. é…ç½®IPv6åœ°å€
ip -6 addr add 2001:db8:1:1::1/64 dev sit1
ip -6 addr add 2001:db8:1:2::1/64 dev sit1

# 4. é…ç½®è·¯ç”±
ip -6 route add 2001:db8:2::/48 dev sit1
ip -6 route add default dev sit1

# æŸ¥çœ‹éš§é“çŠ¶æ€
ip tunnel show
ip -6 addr show sit1
ip -6 route show dev sit1
```

**æ°¸ä¹…6in4éš§é“é…ç½®ï¼š**
```bash
# /etc/network/interfaces (Debian/Ubuntu)
auto sit1
iface sit1 inet6 static
    pre-up ip tunnel add sit1 mode sit remote 203.0.113.10 local 192.0.2.10
    address 2001:db8:1:1::1
    netmask 64
    gateway 2001:db8:1:1::2
    post-down ip tunnel del sit1

# é‡å¯ç½‘ç»œæœåŠ¡
systemctl restart networking
```

#### ğŸ”¸ Hurricane Electricéš§é“é…ç½®

```bash
# HE Tunnel Brokeré…ç½®ç¤ºä¾‹
# https://tunnelbroker.net/

# éš§é“ä¿¡æ¯ï¼ˆç¤ºä¾‹ï¼‰ï¼š
# æœåŠ¡å™¨ç«¯ç‚¹ï¼š216.66.80.26
# å®¢æˆ·ç«¯ç«¯ç‚¹ï¼šæ‚¨çš„å…¬ç½‘IPv4åœ°å€  
# éš§é“IPv6ï¼š2001:470:1f06:1ac::2/64
# è·¯ç”±å—ï¼š2001:470:1f07:1ac::/64

# é…ç½®å‘½ä»¤ï¼š
modprobe sit
ip tunnel add he-ipv6 mode sit remote 216.66.80.26 local YOUR_IPV4_ADDR
ip link set he-ipv6 up
ip addr add 2001:470:1f06:1ac::2/64 dev he-ipv6
ip route add ::/0 dev he-ipv6
ip -6 addr add 2001:470:1f07:1ac::1/64 dev eth0

# æµ‹è¯•è¿é€šæ€§
ping6 2001:470:1f06:1ac::1      # pingéš§é“å¯¹ç«¯
ping6 ipv6.google.com           # æµ‹è¯•IPv6äº’è”ç½‘è¿é€šæ€§
```

### 9.3 6to4éš§é“é…ç½®


#### ğŸ”¸ 6to4éš§é“åŸç†

**ä»€ä¹ˆæ˜¯6to4ï¼Ÿ**
> 6to4å°±åƒ"è‡ªåŠ¨å»ºæ¡¥æŠ€æœ¯"ï¼Œä»»ä½•æ‹¥æœ‰å…¬ç½‘IPv4åœ°å€çš„è®¾å¤‡éƒ½å¯ä»¥è‡ªåŠ¨è·å¾—IPv6åœ°å€ç©ºé—´ï¼Œæ— éœ€ç”³è¯·ï¼ŒIPv4åœ°å€ç›´æ¥åµŒå…¥åˆ°IPv6åœ°å€ä¸­ã€‚

```
6to4åœ°å€ç”Ÿæˆè§„åˆ™ï¼š
IPv4åœ°å€ï¼š203.0.113.10 (CB007170 in hex)
6to4å‰ç¼€ï¼š2002::/16
6to4åœ°å€ï¼š2002:cb00:7170::/48

å®Œæ•´åœ°å€ç¤ºä¾‹ï¼š
ç½‘ç»œï¼š2002:cb00:7170:0001::/64  (å­ç½‘1)
ç½‘ç»œï¼š2002:cb00:7170:0002::/64  (å­ç½‘2)
ä¸»æœºï¼š2002:cb00:7170:0001::1/64 (å­ç½‘1ä¸­çš„ä¸»æœº)
```

#### ğŸ”¸ 6to4ä¸­ç»§é…ç½®

```bash
# é…ç½®6to4éš§é“æ¥å£
modprobe sit
ip tunnel add tun6to4 mode sit ttl 64
ip link set tun6to4 up

# è®¡ç®—6to4åœ°å€ï¼ˆå‡è®¾å…¬ç½‘IPä¸º203.0.113.10ï¼‰
# 203.0.113.10 = CB007170 (hex)
IPV4_ADDR="203.0.113.10"
IPV6_PREFIX="2002:$(echo $IPV4_ADDR | awk -F. '{printf "%02x%02x:%02x%02x", $1, $2, $3, $4}')"

echo "6to4å‰ç¼€ï¼š$IPV6_PREFIX::/48"

# é…ç½®6to4åœ°å€
ip -6 addr add $IPV6_PREFIX:1::1/64 dev eth0       # å†…ç½‘æ¥å£
ip addr add 192.88.99.1/32 dev tun6to4             # 6to4ä¸­ç»§anycast

# é…ç½®6to4è·¯ç”±
ip -6 route add 2002::/16 dev tun6to4              # æ‰€æœ‰6to4ç½‘ç»œ
ip -6 route add default via ::192.88.99.1 dev tun6to4  # é€šè¿‡6to4ä¸­ç»§

# å¯ç”¨6to4ä¸­ç»§åŠŸèƒ½
echo 1 > /proc/sys/net/ipv6/conf/all/forwarding
```

#### ğŸ”¸ 6to4è·¯ç”±å™¨é…ç½®

```bash
#!/bin/bash
# 6to4è·¯ç”±å™¨é…ç½®è„šæœ¬

# è·å–å¤–ç½‘æ¥å£çš„IPv4åœ°å€
EXT_IF="eth0"
INT_IF="eth1"
IPV4_ADDR=$(ip addr show $EXT_IF | grep 'inet ' | awk '{print $2}' | cut -d'/' -f1)

if [ -z "$IPV4_ADDR" ]; then
    echo "é”™è¯¯ï¼šæ— æ³•è·å–å¤–ç½‘IPv4åœ°å€"
    exit 1
fi

# è®¡ç®—6to4å‰ç¼€
HEX_ADDR=$(printf "%02x%02x:%02x%02x" $(echo $IPV4_ADDR | tr '.' ' '))
V6_PREFIX="2002:$HEX_ADDR"

echo "IPv4åœ°å€ï¼š$IPV4_ADDR"
echo "6to4å‰ç¼€ï¼š$V6_PREFIX::/48"

# é…ç½®6to4éš§é“
modprobe sit
ip tunnel add tun6to4 mode sit ttl 64 remote any local $IPV4_ADDR
ip link set tun6to4 up
ip addr add 192.88.99.1/32 dev tun6to4

# é…ç½®å†…ç½‘IPv6
ip -6 addr add $V6_PREFIX:1::1/64 dev $INT_IF

# é…ç½®è·¯ç”±
ip -6 route add 2002::/16 dev tun6to4
ip -6 route add default via ::192.88.99.1 dev tun6to4

# å¯ç”¨è½¬å‘
echo 1 > /proc/sys/net/ipv6/conf/all/forwarding

# é…ç½®radvdé€šå‘ŠIPv6å‰ç¼€
cat > /etc/radvd.conf << EOF
interface $INT_IF {
    AdvSendAdvertisements on;
    prefix $V6_PREFIX:1::/64 {
        AdvOnLink on;
        AdvAutonomous on;
    };
};
EOF

systemctl restart radvd

echo "6to4é…ç½®å®Œæˆï¼"
echo "å†…ç½‘è®¾å¤‡å°†è‡ªåŠ¨è·å¾— $V6_PREFIX:1::/64 ç½‘æ®µçš„IPv6åœ°å€"
```

### 9.4 Teredoéš§é“é…ç½®


#### ğŸ”¸ TeredoåŸºç¡€æ¦‚å¿µ

**ä»€ä¹ˆæ˜¯Teredoï¼Ÿ**
> Teredoå°±åƒ"æ™ºèƒ½ç©¿å¢™æœ¯"ï¼Œä¸“é—¨è§£å†³NATåé¢çš„è®¾å¤‡å¦‚ä½•è·å¾—IPv6è¿æ¥çš„é—®é¢˜ï¼Œé€šè¿‡UDPå°è£…ç©¿é€NATï¼Œè®©å®¶åº­ç”¨æˆ·ä¹Ÿèƒ½äº«å—IPv6ã€‚

```
Teredoå·¥ä½œåŸç†ï¼š
1. å®¢æˆ·ç«¯è”ç³»TeredoæœåŠ¡å™¨è·å–é…ç½®
2. æœåŠ¡å™¨è¿”å›Teredo IPv6å‰ç¼€å’ŒæœåŠ¡å™¨ä¿¡æ¯
3. å®¢æˆ·ç«¯é…ç½®Teredoåœ°å€ï¼š2001:0::/32å‰ç¼€ + æœåŠ¡å™¨åœ°å€ + NATä¿¡æ¯
4. é€šè¿‡UDPç«¯å£3544å°è£…IPv6æ•°æ®åŒ…
5. ä½¿ç”¨Teredoä¸­ç»§å®ç°ä¸åŸç”ŸIPv6çš„é€šä¿¡

Teredoåœ°å€æ ¼å¼ï¼š
2001:0000:4137:9e76:8000:63bf:3fff:fdd2
â”‚    â”‚   â”‚          â”‚    â”‚    â”‚
â”‚    â”‚   æœåŠ¡å™¨IPv4   â”‚    â”‚    â”‚
â”‚    â”‚              æ ‡å¿—  â”‚    ç«¯å£(å€’åº)
â”‚    å‰ç¼€                 NATå¤–éƒ¨IP(å€’åº)
å…¨å±€å‰ç¼€
```

#### ğŸ”¸ Linux Teredoå®¢æˆ·ç«¯é…ç½®

```bash
# å®‰è£…Miredoï¼ˆLinux Teredoå®ç°ï¼‰
sudo apt install miredo

# é…ç½®Miredo
# /etc/miredo/miredo.conf
RelayPrefix 2001::/32
ServerAddress teredo.remlab.net
ServerPort 3544
InterfaceName teredo
BindAddress ::
BindPort 3544

# å¯åŠ¨MiredoæœåŠ¡
systemctl start miredo
systemctl enable miredo

# æŸ¥çœ‹Teredoæ¥å£çŠ¶æ€
ip -6 addr show teredo
ip -6 route show dev teredo

# æµ‹è¯•Teredoè¿é€šæ€§
ping6 2001:4860:4860::8888
```

#### ğŸ”¸ TeredoæœåŠ¡å™¨é…ç½®

```bash
# å®‰è£…TeredoæœåŠ¡å™¨
sudo apt install miredo-server

# é…ç½®TeredoæœåŠ¡å™¨
# /etc/miredo-server/miredo-server.conf
ListenAddress 0.0.0.0
ListenPort 3544
ServerBindAddress YOUR_PUBLIC_IPV4
RelayPrefix 2001::/32
PrimaryAddress YOUR_PUBLIC_IPV4
SecondaryAddress YOUR_SECONDARY_IPV4

# å¯åŠ¨æœåŠ¡
systemctl start miredo-server
systemctl enable miredo-server

# é˜²ç«å¢™é…ç½®
ufw allow 3544/udp
```

### 9.5 ISATAPéš§é“é…ç½®


#### ğŸ”¸ ISATAPæ¦‚å¿µå’Œåº”ç”¨

**ä»€ä¹ˆæ˜¯ISATAPï¼Ÿ**
> ISATAPï¼ˆIntra-Site Automatic Tunnel Addressing Protocolï¼‰æ˜¯"ä¼ä¸šå†…ç½‘è‡ªåŠ¨éš§é“"ï¼Œè®©ä¼ä¸šå†…éƒ¨çš„IPv4ç½‘ç»œèƒ½å¤Ÿæ‰¿è½½IPv6æµé‡ï¼Œæ— éœ€æ”¹å˜ç°æœ‰ç½‘ç»œæ¶æ„ã€‚

```bash
# ISATAPåœ°å€æ ¼å¼ï¼š
# å‰ç¼€:0000:5efe:IPv4åœ°å€

# ç¤ºä¾‹ï¼š
# IPv4åœ°å€ï¼š192.168.1.100  
# ISATAPåœ°å€ï¼š2001:db8:1::/64 + 0000:5efe:c0a8:0164
# å®Œæ•´åœ°å€ï¼š2001:db8:1::5efe:192.168.1.100

# Linux ISATAPé…ç½®
modprobe sit
ip tunnel add isatap0 mode sit ttl 64 remote any local 192.168.1.100
ip link set isatap0 up

# é…ç½®ISATAPåœ°å€
ip -6 addr add 2001:db8:1::5efe:192.168.1.100/64 dev isatap0

# é…ç½®è·¯ç”±
ip -6 route add 2001:db8:1::/64 dev isatap0
```

### 9.6 éš§é“æ€§èƒ½ä¼˜åŒ–


#### ğŸ”¸ éš§é“MTUä¼˜åŒ–

```bash
# æŸ¥çœ‹éš§é“MTU
ip link show sit1

# æ‰‹åŠ¨è®¾ç½®éš§é“MTU
ip link set sit1 mtu 1480

# è‡ªåŠ¨MTUå‘ç°
echo 1 > /proc/sys/net/ipv4/ip_no_pmtu_disc   # å¯ç”¨PMTUå‘ç°

# æµ‹è¯•æœ€ä¼˜MTU
for mtu in 1280 1400 1480 1500; do
    echo "æµ‹è¯•MTU: $mtu"
    ip link set sit1 mtu $mtu
    if ping6 -c 1 -s $(($mtu-40)) 2001:4860:4860::8888 >/dev/null 2>&1; then
        echo "MTU $mtu: æˆåŠŸ"
    else
        echo "MTU $mtu: å¤±è´¥"
    fi
done
```

#### ğŸ”¸ éš§é“ç›‘æ§å’Œæ•…éšœè¯Šæ–­

```bash
# ç›‘æ§éš§é“æ¥å£ç»Ÿè®¡
watch -n 1 'cat /proc/net/dev | grep sit'

# æŸ¥çœ‹éš§é“çŠ¶æ€
ip -s tunnel show

# è°ƒè¯•éš§é“æ•°æ®åŒ…
tcpdump -i sit1 -n icmp6
tcpdump -i eth0 -n proto 41   # ç›‘æ§6in4éš§é“æµé‡

# éš§é“è¿é€šæ€§æµ‹è¯•è„šæœ¬
#!/bin/bash
# tunnel_test.sh

TUNNEL_IF="sit1"
REMOTE_IPV6="2001:4860:4860::8888"

echo "=== éš§é“è¿é€šæ€§æµ‹è¯• ==="

# æ£€æŸ¥éš§é“æ¥å£çŠ¶æ€
if ip link show $TUNNEL_IF >/dev/null 2>&1; then
    echo "âœ… éš§é“æ¥å£å­˜åœ¨"
    
    # æ£€æŸ¥æ¥å£æ˜¯å¦UP
    if ip link show $TUNNEL_IF | grep -q "UP"; then
        echo "âœ… éš§é“æ¥å£å·²å¯ç”¨"
        
        # æµ‹è¯•IPv6è¿é€šæ€§
        if ping6 -c 3 -W 5 $REMOTE_IPV6 >/dev/null 2>&1; then
            echo "âœ… IPv6è¿é€šæ€§æ­£å¸¸"
        else
            echo "âŒ IPv6è¿é€šæ€§å¼‚å¸¸"
        fi
    else
        echo "âŒ éš§é“æ¥å£æœªå¯ç”¨"
    fi
else
    echo "âŒ éš§é“æ¥å£ä¸å­˜åœ¨"
fi

# æ£€æŸ¥è·¯ç”±
echo "å½“å‰IPv6è·¯ç”±ï¼š"
ip -6 route show dev $TUNNEL_IF
```

**éš§é“æŠ€æœ¯é€‰æ‹©æŒ‡å—ï¼š**
```
ğŸ¯ æŠ€æœ¯é€‰æ‹©å»ºè®®ï¼š

6in4éš§é“ï¼š
âœ… é€‚ç”¨ï¼šæœ‰å…¬ç½‘IPv4ï¼Œéœ€è¦ç¨³å®šè¿æ¥
âœ… åœºæ™¯ï¼šæœåŠ¡å™¨ã€ä¼ä¸šç½‘ç»œ
âŒ é™åˆ¶ï¼šä¸ç©¿è¶ŠNAT

6to4éš§é“ï¼š  
âœ… é€‚ç”¨ï¼šè‡ªåŠ¨é…ç½®ï¼Œä¸´æ—¶ä½¿ç”¨
âœ… åœºæ™¯ï¼šå¿«é€Ÿæµ‹è¯•ï¼Œç®€å•éƒ¨ç½²
âŒ é™åˆ¶ï¼šä¾èµ–å…¬ç½‘6to4ä¸­ç»§

Teredoéš§é“ï¼š
âœ… é€‚ç”¨ï¼šNATåé¢çš„å®¢æˆ·ç«¯
âœ… åœºæ™¯ï¼šå®¶åº­ç”¨æˆ·ï¼Œç§»åŠ¨è®¾å¤‡  
âŒ é™åˆ¶ï¼šæ€§èƒ½è¾ƒå·®ï¼Œä¾èµ–ä¸­ç»§æœåŠ¡

ISATAPéš§é“ï¼š
âœ… é€‚ç”¨ï¼šä¼ä¸šå†…ç½‘IPv6éƒ¨ç½²
âœ… åœºæ™¯ï¼šæ¸è¿›å¼IPv6éƒ¨ç½²
âŒ é™åˆ¶ï¼šä»…é™å†…ç½‘ä½¿ç”¨

ğŸ¯ æ€§èƒ½å¯¹æ¯”ï¼š
åŸç”ŸIPv6 > 6in4 > ISATAP > 6to4 > Teredo

ğŸ¯ éƒ¨ç½²éš¾åº¦ï¼š
6to4 < Teredo < ISATAP < 6in4 < åŸç”ŸIPv6
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ IPv6åœ°å€ï¼š128ä½åˆ†å±‚åœ°å€ï¼Œæ”¯æŒå•æ’­ã€ç»„æ’­ã€ä»»æ’­
ğŸ”¸ SLAACæœºåˆ¶ï¼šæ— çŠ¶æ€è‡ªåŠ¨é…ç½®ï¼Œå®ç°å³æ’å³ç”¨
ğŸ”¸ åŒæ ˆé…ç½®ï¼šIPv4/IPv6å…±å­˜ï¼Œå¹³æ»‘è¿‡æ¸¡æ–¹æ¡ˆ  
ğŸ”¸ NDPåè®®ï¼šé‚»å±…å‘ç°ï¼Œæ¯”ARPåŠŸèƒ½æ›´å¼ºå¤§
ğŸ”¸ è·¯ç”±é…ç½®ï¼šé™æ€è·¯ç”±ã€åŠ¨æ€åè®®ã€ç­–ç•¥è·¯ç”±
ğŸ”¸ DNSæ”¯æŒï¼šAAAAè®°å½•ã€åå‘è§£æã€åŒæ ˆDNS
ğŸ”¸ è¿é€šæ€§æµ‹è¯•ï¼šping6ã€traceroute6ã€æ€§èƒ½æµ‹è¯•
ğŸ”¸ éš§é“æŠ€æœ¯ï¼š6in4ã€6to4ã€Teredoè¿‡æ¸¡æ–¹æ¡ˆ
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ IPv6åœ°å€çš„å±‚æ¬¡åŒ–è®¾è®¡**
```
åœ°å€ç»“æ„ä¼˜åŠ¿ï¼š
â€¢ åˆ†å±‚åˆ†é…é¿å…è·¯ç”±è¡¨è†¨èƒ€
â€¢ è‡ªåŠ¨é…ç½®ç®€åŒ–ç½‘ç»œç®¡ç†
â€¢ å……è¶³åœ°å€ç©ºé—´æ”¯æŒç‰©è”ç½‘
â€¢ å†…ç½®å®‰å…¨å’Œç§»åŠ¨æ€§æ”¯æŒ
```

**ğŸ”¹ è‡ªåŠ¨é…ç½®çš„ä¾¿åˆ©æ€§**
```
SLAACçš„ä»·å€¼ï¼š
â€¢ å‡å°‘æ‰‹å·¥é…ç½®é”™è¯¯
â€¢ æ”¯æŒå³æ’å³ç”¨
â€¢ é€‚åº”ç§»åŠ¨ç½‘ç»œç¯å¢ƒ
â€¢ é™ä½ç½‘ç»œç®¡ç†æˆæœ¬
```

**ğŸ”¹ åŒæ ˆè¿‡æ¸¡çš„å¿…è¦æ€§**
```
è¿‡æ¸¡æœŸç­–ç•¥ï¼š
â€¢ ä¿æŒIPv4å…¼å®¹æ€§
â€¢ é€æ­¥å¢åŠ IPv6ä½¿ç”¨ç‡
â€¢ é¿å…æœåŠ¡ä¸­æ–­
â€¢ ä¸ºæœ€ç»ˆè¿ç§»åšå‡†å¤‡
```

**ğŸ”¹ éš§é“æŠ€æœ¯çš„è¿‡æ¸¡ä»·å€¼**
```
éš§é“åº”ç”¨åœºæ™¯ï¼š
â€¢ è¿æ¥IPv6å­¤å²›ç½‘ç»œ
â€¢ ä¸ºIPv4ç½‘ç»œæä¾›IPv6è®¿é—®
â€¢ æµ‹è¯•IPv6æœåŠ¡å¯ç”¨æ€§
â€¢ ä¼ä¸šç½‘ç»œæ¸è¿›å¼éƒ¨ç½²
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä¸åŒç¯å¢ƒçš„éƒ¨ç½²ç­–ç•¥**

```
å®¶åº­ç½‘ç»œéƒ¨ç½²ï¼š
1. æ£€æŸ¥ISPæ˜¯å¦æ”¯æŒIPv6
2. è·¯ç”±å™¨å¯ç”¨IPv6åŠŸèƒ½
3. è®¾å¤‡è‡ªåŠ¨è·å–IPv6åœ°å€
4. æµ‹è¯•åŒæ ˆè¿é€šæ€§
5. å¿…è¦æ—¶ä½¿ç”¨éš§é“æœåŠ¡

ä¼ä¸šç½‘ç»œéƒ¨ç½²ï¼š
1. è§„åˆ’IPv6åœ°å€åˆ†é…
2. é…ç½®DNSåŒæ ˆè®°å½•
3. æ›´æ–°é˜²ç«å¢™è§„åˆ™
4. åŸ¹è®­æŠ€æœ¯äººå‘˜
5. åˆ†é˜¶æ®µæ¨è¿›éƒ¨ç½²

æ•°æ®ä¸­å¿ƒéƒ¨ç½²ï¼š
1. è·å–IPv6åœ°å€æ®µ
2. é…ç½®è´Ÿè½½å‡è¡¡å™¨
3. æ›´æ–°ç›‘æ§ç³»ç»Ÿ
4. æµ‹è¯•ç¾å¤‡æ–¹æ¡ˆ
5. ä¼˜åŒ–ç½‘ç»œæ€§èƒ½
```

**ğŸ¯ è¿ç»´ç®¡ç†ç­–ç•¥**

```
ç›‘æ§è¦ç‚¹ï¼š
â€¢ IPv6åœ°å€åˆ†é…çŠ¶æ€
â€¢ åŒæ ˆæœåŠ¡å¯ç”¨æ€§
â€¢ ç½‘ç»œæ€§èƒ½å¯¹æ¯”
â€¢ å®‰å…¨å¨èƒæ£€æµ‹

æ•…éšœå¤„ç†ï¼š
â€¢ åˆ†å±‚è¯Šæ–­ç½‘ç»œé—®é¢˜
â€¢ å¯¹æ¯”IPv4/IPv6è¡Œä¸ºå·®å¼‚
â€¢ æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸€è‡´æ€§
â€¢ éªŒè¯DNSè§£ææ­£ç¡®æ€§

æ€§èƒ½ä¼˜åŒ–ï¼š
â€¢ è°ƒæ•´MTUé¿å…åˆ†ç‰‡
â€¢ ä¼˜åŒ–è·¯ç”±é€‰æ‹©ç­–ç•¥
â€¢ é…ç½®é€‚å½“çš„ç¼“å­˜
â€¢ ç›‘æ§å¸¦å®½ä½¿ç”¨æƒ…å†µ
```

### 10.4 å¸¸è§é—®é¢˜è§£å†³


**ğŸ”§ é…ç½®é—®é¢˜æ’æŸ¥**

```
åœ°å€é…ç½®é—®é¢˜ï¼š
é—®é¢˜ï¼šè®¾å¤‡æ— æ³•è·å–IPv6åœ°å€
æ’æŸ¥ï¼šæ£€æŸ¥RAé…ç½®â†’éªŒè¯DHCPæœåŠ¡â†’ç¡®è®¤æ¥å£çŠ¶æ€
è§£å†³ï¼šé‡å¯ç½‘ç»œæœåŠ¡â†’é‡æ–°é…ç½®åœ°å€â†’æ£€æŸ¥é˜²ç«å¢™

è¿é€šæ€§é—®é¢˜ï¼š
é—®é¢˜ï¼šIPv6ç½‘ç»œä¸é€š
æ’æŸ¥ï¼špingæœ¬åœ°â†’pingç½‘å…³â†’pingå…¬ç½‘â†’æ£€æŸ¥è·¯ç”±
è§£å†³ï¼šä¿®æ­£è·¯ç”±é…ç½®â†’æ›´æ–°DNSè®¾ç½®â†’è°ƒæ•´é˜²ç«å¢™è§„åˆ™

æ€§èƒ½é—®é¢˜ï¼š
é—®é¢˜ï¼šIPv6è®¿é—®æ¯”IPv4æ…¢
æ’æŸ¥ï¼šå¯¹æ¯”å»¶è¿Ÿâ†’æ£€æŸ¥MTUâ†’åˆ†æè·¯ç”±è·¯å¾„
è§£å†³ï¼šä¼˜åŒ–è·¯ç”±é€‰æ‹©â†’è°ƒæ•´MTUå¤§å°â†’è”ç³»ISPä¼˜åŒ–
```

**ğŸ”§ å®‰å…¨é…ç½®è¦ç‚¹**

```
IPv6å®‰å…¨è€ƒè™‘ï¼š
â€¢ åœ°å€ç©ºé—´æ‰«æå›°éš¾ä½†ä»éœ€é˜²æŠ¤
â€¢ NDPæ”»å‡»å’ŒARPæ¬ºéª—ç±»ä¼¼éœ€è¦é˜²èŒƒ
â€¢ ICMPv6æ¶ˆæ¯è¿‡æ»¤éœ€è¦è°¨æ…
â€¢ éšç§æ‰©å±•åœ°å€å»ºè®®å¯ç”¨

é˜²ç«å¢™é…ç½®ï¼š
â€¢ ç»´æŠ¤IPv4å’ŒIPv6è§„åˆ™ä¸€è‡´æ€§
â€¢ å…è®¸å¿…è¦çš„ICMPv6æ¶ˆæ¯ç±»å‹
â€¢ é™åˆ¶ä¸å¿…è¦çš„ç»„æ’­æµé‡
â€¢ ç›‘æ§å¼‚å¸¸çš„é‚»å±…å‘ç°æ´»åŠ¨

è®¿é—®æ§åˆ¶ï¼š
â€¢ åŸºäºIPv6åœ°å€çš„è®¿é—®ç­–ç•¥
â€¢ è€ƒè™‘åœ°å€å˜åŒ–å¯¹è®¿é—®æ§åˆ¶çš„å½±å“
â€¢ å®šæœŸå®¡æ ¸IPv6è®¿é—®æ—¥å¿—
â€¢ å»ºç«‹IPv6å®‰å…¨å“åº”æµç¨‹
```

### 10.5 å‘å±•è¶‹åŠ¿å’Œå»ºè®®


**ğŸš€ IPv6å‘å±•è¶‹åŠ¿**

```
æŠ€æœ¯å‘å±•ï¼š
â€¢ IPv6å•æ ˆç½‘ç»œé€æ¸æ™®åŠ
â€¢ 5G/ç‰©è”ç½‘æ¨åŠ¨IPv6éƒ¨ç½²
â€¢ äº‘æœåŠ¡åŸç”Ÿæ”¯æŒIPv6
â€¢ SD-WANé›†æˆIPv6åŠŸèƒ½

è¡Œä¸šæ¨è¿›ï¼š
â€¢ æ”¿åºœæ”¿ç­–æ¨åŠ¨IPv6éƒ¨ç½²
â€¢ äº’è”ç½‘å…¬å¸ç§¯ææ”¯æŒ
â€¢ ç”µä¿¡è¿è¥å•†ç½‘ç»œå‡çº§
â€¢ ä¼ä¸šæ•°å­—åŒ–è½¬å‹éœ€æ±‚

æ ‡å‡†æ¼”è¿›ï¼š
â€¢ IPv6+å¢å¼ºåŠŸèƒ½æ ‡å‡†åŒ–
â€¢ ç½‘ç»œåˆ‡ç‰‡æŠ€æœ¯é›†æˆ
â€¢ å®‰å…¨æœºåˆ¶æŒç»­å®Œå–„
â€¢ è¿ç»´ç®¡ç†å·¥å…·æˆç†Ÿ
```

**ğŸ¯ å­¦ä¹ å’Œå®è·µå»ºè®®**

```
å­¦ä¹ è·¯å¾„ï¼š
1. æŒæ¡IPv6åŸºç¡€æ¦‚å¿µå’Œåœ°å€æ ¼å¼
2. ç†Ÿç»ƒé…ç½®åŒæ ˆç½‘ç»œç¯å¢ƒ
3. ç†è§£å„ç§è¿‡æ¸¡æŠ€æœ¯çš„åº”ç”¨åœºæ™¯
4. å®è·µç½‘ç»œæ•…éšœè¯Šæ–­å’Œä¼˜åŒ–
5. è·Ÿè¸ªIPv6æ–°æŠ€æœ¯å’Œæ ‡å‡†å‘å±•

å®è·µç¯å¢ƒï¼š
â€¢ æ­å»ºè™šæ‹Ÿå®éªŒç¯å¢ƒ
â€¢ ä½¿ç”¨å…è´¹IPv6éš§é“æœåŠ¡
â€¢ å‚ä¸å¼€æºé¡¹ç›®æµ‹è¯•
â€¢ ç”³è¯·IPv6åœ°å€æ®µå®éªŒ

èŒä¸šå‘å±•ï¼š
â€¢ IPv6ç½‘ç»œå·¥ç¨‹å¸ˆéœ€æ±‚å¢é•¿
â€¢ æŒæ¡IPv6çš„ç½‘ç»œç®¡ç†å‘˜æ›´æœ‰ç«äº‰åŠ›
â€¢ äº‘è®¡ç®—å’Œç‰©è”ç½‘é¡¹ç›®é‡è§†IPv6èƒ½åŠ›
â€¢ ç½‘ç»œå®‰å…¨ä¸“å®¶éœ€è¦IPv6å®‰å…¨çŸ¥è¯†
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹ï¼š**

- **IPv6åœ°å€åˆ†å±‚è®¾è®¡**ï¼šå…¨çƒå•æ’­ã€é“¾è·¯æœ¬åœ°ã€ç»„æ’­åœ°å€å„æœ‰ç”¨é€”
- **è‡ªåŠ¨é…ç½®ä¾¿åˆ©**ï¼šSLAACè®©è®¾å¤‡å³æ’å³ç”¨ï¼Œç®€åŒ–ç½‘ç»œç®¡ç†
- **åŒæ ˆè¿‡æ¸¡ç­–ç•¥**ï¼šä¿æŒå…¼å®¹æ€§çš„åŒæ—¶é€æ­¥æ¨è¿›IPv6éƒ¨ç½²
- **NDPåè®®å¼ºå¤§**ï¼šä¸ä»…è§£æåœ°å€ï¼Œè¿˜è´Ÿè´£è·¯ç”±å‘ç°å’Œé…ç½®
- **è·¯ç”±é…ç½®çµæ´»**ï¼šæ”¯æŒé™æ€ã€åŠ¨æ€ã€ç­–ç•¥è·¯ç”±å¤šç§æ–¹å¼
- **DNSåŒæ ˆæ”¯æŒ**ï¼šAå’ŒAAAAè®°å½•å¹¶å­˜ï¼Œç¡®ä¿æœåŠ¡å¯è¾¾æ€§
- **éš§é“æŠ€æœ¯è¿‡æ¸¡**ï¼šåœ¨IPv4ç½‘ç»œä¸Šæ‰¿è½½IPv6ï¼Œè¿æ¥å­¤å²›ç½‘ç»œ
- **è¿é€šæ€§æµ‹è¯•é‡è¦**ï¼šåŠæ—¶å‘ç°é—®é¢˜ï¼Œç¡®ä¿ç½‘ç»œè´¨é‡

> IPv6ä¸ä»…æ˜¯åœ°å€ç©ºé—´çš„æ‰©å±•ï¼Œæ›´æ˜¯ç½‘ç»œæ¶æ„çš„å‡çº§ã€‚æŒæ¡IPv6æŠ€æœ¯ï¼Œå°±æ˜¯æŒæ¡äº†ç½‘ç»œæŠ€æœ¯çš„æœªæ¥å‘å±•æ–¹å‘ã€‚ä»åŸºç¡€é…ç½®åˆ°é«˜çº§åº”ç”¨ï¼Œä»æ•…éšœè¯Šæ–­åˆ°æ€§èƒ½ä¼˜åŒ–ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½éœ€è¦æ‰å®çš„ç†è®ºåŸºç¡€å’Œä¸°å¯Œçš„å®è·µç»éªŒã€‚