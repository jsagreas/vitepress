---
title: 6ã€chownæ‰€æœ‰æƒå˜æ›´å±é™©
---
## ğŸ“š ç›®å½•

1. [chownå‘½ä»¤åŸºç¡€æ¦‚å¿µ](#1-chownå‘½ä»¤åŸºç¡€æ¦‚å¿µ)
2. [chowné€’å½’æ“ä½œçš„å±é™©æ€§](#2-chowné€’å½’æ“ä½œçš„å±é™©æ€§)
3. [ç³»ç»Ÿæ–‡ä»¶æ‰€æœ‰æƒç ´åæ¡ˆä¾‹](#3-ç³»ç»Ÿæ–‡ä»¶æ‰€æœ‰æƒç ´åæ¡ˆä¾‹)
4. [rootç”¨æˆ·æ–‡ä»¶æ‰€æœ‰æƒè½¬ç§»é£é™©](#4-rootç”¨æˆ·æ–‡ä»¶æ‰€æœ‰æƒè½¬ç§»é£é™©)
5. [æœåŠ¡è´¦æˆ·æƒé™æ··ä¹±é—®é¢˜](#5-æœåŠ¡è´¦æˆ·æƒé™æ··ä¹±é—®é¢˜)
6. [å…³é”®ç›®å½•æ‰€æœ‰æƒé”™è¯¯å½±å“](#6-å…³é”®ç›®å½•æ‰€æœ‰æƒé”™è¯¯å½±å“)
7. [æ‰€æœ‰æƒå˜æ›´å®‰å…¨æ£€æŸ¥æœºåˆ¶](#7-æ‰€æœ‰æƒå˜æ›´å®‰å…¨æ£€æŸ¥æœºåˆ¶)
8. [ç³»ç»Ÿæ–‡ä»¶æ‰€æœ‰æƒæ¢å¤æ–¹æ³•](#8-ç³»ç»Ÿæ–‡ä»¶æ‰€æœ‰æƒæ¢å¤æ–¹æ³•)
9. [æ‰€æœ‰æƒå®¡è®¡æœ€ä½³å®è·µ](#9-æ‰€æœ‰æƒå®¡è®¡æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ chownå‘½ä»¤åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯chownå‘½ä»¤


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
`chown`æ˜¯Linuxä¸­ç”¨æ¥æ”¹å˜æ–‡ä»¶å’Œç›®å½•æ‰€æœ‰è€…çš„å‘½ä»¤ï¼Œå…¨ç§°ä¸º"change owner"ã€‚

**ç®€å•ç†è§£ï¼š**
> å°±åƒæˆ¿å­è¿‡æˆ·ä¸€æ ·ï¼Œchownå‘½ä»¤å¯ä»¥æŠŠæ–‡ä»¶çš„"æˆ¿äº§è¯"ä»ä¸€ä¸ªäººåä¸‹è½¬åˆ°å¦ä¸€ä¸ªäººåä¸‹ã€‚

### 1.2 chownå‘½ä»¤çš„åŸºæœ¬è¯­æ³•


**åŸºæœ¬æ ¼å¼ï¼š**
```bash
chown [é€‰é¡¹] ç”¨æˆ·[:ç»„] æ–‡ä»¶/ç›®å½•
```

**å¸¸è§ç”¨æ³•ç¤ºä¾‹ï¼š**
```bash
# æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…ä¸ºuser1
chown user1 file.txt

# åŒæ—¶æ”¹å˜æ‰€æœ‰è€…å’Œç»„
chown user1:group1 file.txt

# åªæ”¹å˜ç»„ï¼ˆæ‰€æœ‰è€…ä¸å˜ï¼‰
chown :group1 file.txt
```

### 1.3 æ–‡ä»¶æ‰€æœ‰æƒçš„é‡è¦æ€§


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä½ çš„å®¶ï¼š
> - **æ‰€æœ‰è€…**ï¼šæˆ¿å­çš„ä¸»äººï¼Œæœ‰å…¨éƒ¨æƒé™
> - **ç»„æˆå‘˜**ï¼šå®¶åº­æˆå‘˜ï¼Œæœ‰éƒ¨åˆ†æƒé™  
> - **å…¶ä»–äºº**ï¼šå¤–äººï¼Œæƒé™æœ€å°‘

**Linuxä¸­çš„æ„ä¹‰ï¼š**
- **å®‰å…¨æ§åˆ¶**ï¼šå†³å®šè°èƒ½è®¿é—®ä»€ä¹ˆæ–‡ä»¶
- **ç³»ç»Ÿç¨³å®š**ï¼šç¡®ä¿ç³»ç»Ÿæ–‡ä»¶ä¸è¢«éšæ„ä¿®æ”¹
- **æƒé™éš”ç¦»**ï¼šä¸åŒç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ–‡ä»¶

### 1.4 æŸ¥çœ‹æ–‡ä»¶æ‰€æœ‰æƒä¿¡æ¯


**ğŸ“Š ä½¿ç”¨ls -læŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š**
```bash
ls -l /etc/passwd
# è¾“å‡ºï¼š-rw-r--r-- 1 root root 2847 Sep 19 10:30 /etc/passwd
#       â†‘æƒé™    â†‘æ‰€æœ‰è€… â†‘æ‰€å±ç»„
```

**ä¿¡æ¯è§£è¯»ï¼š**
- **ç¬¬ä¸€ä¸ªroot**ï¼šæ–‡ä»¶æ‰€æœ‰è€…æ˜¯rootç”¨æˆ·
- **ç¬¬äºŒä¸ªroot**ï¼šæ–‡ä»¶å±äºrootç»„
- **æƒé™ä½**ï¼šrw-r--r-- è¡¨ç¤ºæ‰€æœ‰è€…å¯è¯»å†™ï¼Œç»„å’Œå…¶ä»–äººåªèƒ½è¯»

---

## 2. âš ï¸ chowné€’å½’æ“ä½œçš„å±é™©æ€§


### 2.1 ä»€ä¹ˆæ˜¯é€’å½’æ“ä½œ


**ğŸ”¸ -Rå‚æ•°çš„å«ä¹‰**
`-R`æˆ–`--recursive`å‚æ•°è®©chownå‘½ä»¤é€’å½’åœ°å¤„ç†ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶ã€‚

**ğŸ“ ç›®å½•ç»“æ„ç¤ºä¾‹ï¼š**
```
/home/user/
â”œâ”€â”€ documents/
â”‚   â”œâ”€â”€ work/
â”‚   â”‚   â””â”€â”€ report.doc
â”‚   â””â”€â”€ personal/
â”‚       â””â”€â”€ diary.txt
â””â”€â”€ photos/
    â””â”€â”€ vacation.jpg
```

**é€’å½’æ“ä½œæ•ˆæœï¼š**
```bash
# è¿™ä¸ªå‘½ä»¤ä¼šæ”¹å˜userç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•çš„æ‰€æœ‰æƒ
chown -R newuser:newgroup /home/user/
```

### 2.2 é€’å½’æ“ä½œçš„æ½œåœ¨å±é™©


**ğŸš¨ å±é™©åœºæ™¯1ï¼šè¯¯æ“ä½œæ ¹ç›®å½•**
```bash
# æåº¦å±é™©ï¼šè¿™ä¼šæ”¹å˜æ•´ä¸ªç³»ç»Ÿçš„æ‰€æœ‰æƒï¼
chown -R user1:user1 /
```

**åæœï¼š**
- ç³»ç»Ÿæ— æ³•å¯åŠ¨
- æ‰€æœ‰ç³»ç»ŸæœåŠ¡å¤±æ•ˆ
- éœ€è¦é‡è£…ç³»ç»Ÿæ‰èƒ½æ¢å¤

**ğŸš¨ å±é™©åœºæ™¯2ï¼šæ“ä½œç³»ç»Ÿå…³é”®ç›®å½•**
```bash
# å±é™©ï¼šæ”¹å˜ç³»ç»Ÿé…ç½®ç›®å½•æ‰€æœ‰æƒ
chown -R user1:user1 /etc/
```

**åæœï¼š**
- ç³»ç»Ÿé…ç½®æ–‡ä»¶è¢«æ™®é€šç”¨æˆ·æ§åˆ¶
- å®‰å…¨ç­–ç•¥å¤±æ•ˆ
- æœåŠ¡æ— æ³•æ­£å¸¸å¯åŠ¨

### 2.3 é€’å½’æ“ä½œçš„å¸¸è§é”™è¯¯


**ğŸ’¥ è·¯å¾„é”™è¯¯å¯¼è‡´çš„ç¾éš¾**
```bash
# æƒ³è¦æ“ä½œ /home/user/documents
# ä½†æ˜¯æ‰‹è¯¯æ‰“æˆäº† /home/user /documents
chown -R user1:user1 /home/user /documents

# æˆ–è€…æ›´ç³Ÿç³•çš„æƒ…å†µ
chown -R user1:user1 / home/user/documents
#                    â†‘ æ³¨æ„è¿™ä¸ªç©ºæ ¼ï¼è¿™ä¼šæ“ä½œæ ¹ç›®å½•ï¼
```

**ğŸ” æ£€æŸ¥æ¸…å•**
åœ¨æ‰§è¡Œé€’å½’chownå‰åŠ¡å¿…æ£€æŸ¥ï¼š
- [ ] è·¯å¾„æ˜¯å¦æ­£ç¡®
- [ ] æ˜¯å¦æœ‰æ‹¼å†™é”™è¯¯
- [ ] ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ä½ç½®
- [ ] ç›®æ ‡ç”¨æˆ·å’Œç»„æ˜¯å¦å­˜åœ¨

### 2.4 å®‰å…¨çš„é€’å½’æ“ä½œæ–¹æ³•


**ğŸ“ æœ€ä½³å®è·µï¼š**

1. **å…ˆæµ‹è¯•è·¯å¾„**
```bash
# ç”¨lsç¡®è®¤è·¯å¾„æ­£ç¡®
ls -la /path/to/directory
```

2. **ä½¿ç”¨ç»å¯¹è·¯å¾„**
```bash
# é¿å…ç›¸å¯¹è·¯å¾„å¯èƒ½çš„æ­§ä¹‰
chown -R user:group /home/user/specific/directory
```

3. **åˆ†æ­¥éª¤æ“ä½œ**
```bash
# å¯¹äºé‡è¦ç›®å½•ï¼Œå¯ä»¥åˆ†å±‚çº§æ“ä½œ
chown user:group /home/user/documents
chown -R user:group /home/user/documents/*
```

---

## 3. ğŸ’¥ ç³»ç»Ÿæ–‡ä»¶æ‰€æœ‰æƒç ´åæ¡ˆä¾‹


### 3.1 å¸¸è§çš„ç³»ç»Ÿæ–‡ä»¶æ‰€æœ‰æƒç ´å


**ğŸ”¸ /etcç›®å½•æ‰€æœ‰æƒç ´å**

**æ­£å¸¸çŠ¶æ€ï¼š**
```bash
ls -la /etc/passwd /etc/shadow /etc/group
-rw-r--r-- 1 root root   2847 Sep 19 10:30 /etc/passwd
-rw-r----- 1 root shadow 1523 Sep 19 10:30 /etc/shadow
-rw-r--r-- 1 root root   1456 Sep 19 10:30 /etc/group
```

**ç ´ååçŠ¶æ€ï¼š**
```bash
# é”™è¯¯æ‰§è¡Œï¼šchown -R user1:user1 /etc/
-rw-r--r-- 1 user1 user1   2847 Sep 19 10:30 /etc/passwd
-rw-r----- 1 user1 user1   1523 Sep 19 10:30 /etc/shadow
-rw-r--r-- 1 user1 user1   1456 Sep 19 10:30 /etc/group
```

**ğŸš¨ ä¸¥é‡åæœï¼š**
- ç³»ç»Ÿè®¤è¯æœºåˆ¶å¤±æ•ˆ
- ç”¨æˆ·æ— æ³•ç™»å½•ï¼ˆåŒ…æ‹¬rootï¼‰
- ç³»ç»ŸæœåŠ¡æ— æ³•å¯åŠ¨
- SSHè¿æ¥è¢«æ‹’ç»

### 3.2 /varç›®å½•æ‰€æœ‰æƒç ´å


**ğŸ”¸ æ—¥å¿—ç³»ç»Ÿå´©æºƒ**
```bash
# é”™è¯¯æ“ä½œ
chown -R user1:user1 /var/log/
```

**å½±å“åˆ†æï¼š**

| æ–‡ä»¶/ç›®å½• | æ­£å¸¸æ‰€æœ‰æƒ | ç ´ååæ‰€æœ‰æƒ | å½±å“ |
|-----------|------------|--------------|------|
| `/var/log/syslog` | `syslog:adm` | `user1:user1` | ç³»ç»Ÿæ—¥å¿—æ— æ³•å†™å…¥ |
| `/var/log/auth.log` | `root:adm` | `user1:user1` | è®¤è¯æ—¥å¿—å¤±æ•ˆ |
| `/var/log/apache2/` | `www-data:adm` | `user1:user1` | WebæœåŠ¡å™¨æ—¥å¿—å¤±æ•ˆ |

### 3.3 /usrç›®å½•æ‰€æœ‰æƒç ´å


**ğŸ”¸ ç³»ç»Ÿç¨‹åºæ— æ³•æ‰§è¡Œ**
```bash
# å±é™©æ“ä½œ
chown -R user1:user1 /usr/bin/
```

**ç³»ç»Ÿç¨‹åºæ‰§è¡Œå›¾ï¼š**
```
ç”¨æˆ·æ‰§è¡Œå‘½ä»¤ â†’ /usr/bin/ç¨‹åº â†’ æƒé™æ£€æŸ¥ â†’ æ‰§è¡Œå¤±è´¥
                     â†‘
               æ‰€æœ‰æƒä¸æ˜¯rootï¼Œç³»ç»Ÿæ‹’ç»æ‰§è¡Œ
```

**å…¸å‹ç—‡çŠ¶ï¼š**
- `sudo`å‘½ä»¤å¤±æ•ˆ
- ç³»ç»Ÿå·¥å…·æ— æ³•ä½¿ç”¨
- åŒ…ç®¡ç†å™¨åœæ­¢å·¥ä½œ

### 3.4 å®é™…ç ´åæ¡ˆä¾‹åˆ†æ


**ğŸ“‹ æ¡ˆä¾‹ï¼šè¿ç»´å·¥ç¨‹å¸ˆçš„è¯¯æ“ä½œ**

**èƒŒæ™¯ï¼š**
è¿ç»´äººå‘˜æƒ³è¦å°†Webç›®å½•çš„æ‰€æœ‰æƒæ”¹ä¸ºwww-dataç”¨æˆ·ï¼Œä½†è·¯å¾„è¾“å…¥é”™è¯¯ã€‚

**é”™è¯¯å‘½ä»¤ï¼š**
```bash
# æœ¬æ„ï¼šchown -R www-data:www-data /var/www/html/
# å®é™…ï¼šchown -R www-data:www-data /var/www /html/
```

**é—®é¢˜åˆ†æï¼š**
- è·¯å¾„ä¸­å¤šäº†ä¸€ä¸ªç©ºæ ¼
- å¯¼è‡´åŒæ—¶æ“ä½œäº†`/var/www`å’Œ`/html/`ä¸¤ä¸ªè·¯å¾„
- `/html/`ä¸å­˜åœ¨ï¼Œä½†`/var/www`è¢«å®Œå…¨æ”¹å˜æ‰€æœ‰æƒ

**ä¿®å¤è¿‡ç¨‹ï¼š**
1. **ç´§æ€¥æ¢å¤å…³é”®æ–‡ä»¶**
```bash
chown root:root /var/www
```

2. **æ£€æŸ¥å½±å“èŒƒå›´**
```bash
find /var/www -not -user www-data -not -group www-data
```

3. **é€æ­¥æ¢å¤æ­£ç¡®æƒé™**
```bash
chown -R www-data:www-data /var/www/html/
chown root:root /var/www
```

---

## 4. ğŸ‘‘ rootç”¨æˆ·æ–‡ä»¶æ‰€æœ‰æƒè½¬ç§»é£é™©


### 4.1 rootæ–‡ä»¶æ‰€æœ‰æƒçš„ç‰¹æ®Šæ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆrootæ–‡ä»¶æ‰€æœ‰æƒå¾ˆé‡è¦**

**ç”Ÿæ´»ç±»æ¯”ï¼š**
> rootç”¨æˆ·å°±åƒå…¬å¸çš„æ€»ç»ç†ï¼Œæœ‰äº›é‡è¦æ–‡ä»¶å¿…é¡»ç”±æ€»ç»ç†ä¿ç®¡ï¼Œå¦‚æœè½¬ç»™æ™®é€šå‘˜å·¥ï¼Œå…¬å¸å°±ä¹±å¥—äº†ã€‚

**ç³»ç»Ÿå±‚é¢çš„æ„ä¹‰ï¼š**
- **å®‰å…¨å±éšœ**ï¼šé˜²æ­¢æ™®é€šç”¨æˆ·ä¿®æ”¹å…³é”®ç³»ç»Ÿæ–‡ä»¶
- **æƒé™éš”ç¦»**ï¼šç¡®ä¿ç³»ç»Ÿçº§æ“ä½œåªæœ‰ç®¡ç†å‘˜èƒ½æ‰§è¡Œ
- **å®Œæ•´æ€§ä¿æŠ¤**ï¼šç»´æŠ¤ç³»ç»Ÿé…ç½®çš„ä¸€è‡´æ€§

### 4.2 å¸¸è§çš„rootæ–‡ä»¶æ‰€æœ‰æƒè½¬ç§»é”™è¯¯


**ğŸš¨ å±é™©æ“ä½œ1ï¼šè½¬ç§»ç³»ç»Ÿé…ç½®æ–‡ä»¶**
```bash
# å±é™©ï¼šå°†é‡è¦é…ç½®æ–‡ä»¶äº¤ç»™æ™®é€šç”¨æˆ·
chown user1:user1 /etc/sudoers
```

**åæœåˆ†æï¼š**
```
æ™®é€šç”¨æˆ·è·å¾—sudoersæ§åˆ¶æƒ â†’ å¯ä»¥ä¿®æ”¹sudoè§„åˆ™ â†’ è·å¾—rootæƒé™ â†’ ç³»ç»Ÿå®‰å…¨å¤±æ•ˆ
```

**ğŸš¨ å±é™©æ“ä½œ2ï¼šè½¬ç§»ç³»ç»ŸæœåŠ¡æ–‡ä»¶**
```bash
# å±é™©ï¼šæ”¹å˜ç³»ç»ŸæœåŠ¡çš„æ‰€æœ‰æƒ
chown -R user1:user1 /etc/systemd/system/
```

**å½±å“é“¾æ¡ï¼š**
```
æœåŠ¡é…ç½®æ–‡ä»¶è¢«æ™®é€šç”¨æˆ·æ§åˆ¶
â†“
ç”¨æˆ·å¯ä»¥ä¿®æ”¹æœåŠ¡å¯åŠ¨å‚æ•°
â†“
å¯èƒ½æ³¨å…¥æ¶æ„ä»£ç 
â†“
ç³»ç»Ÿå®‰å…¨å®Œå…¨å¤±æ§
```

### 4.3 rootæ–‡ä»¶è¯†åˆ«æ–¹æ³•


**ğŸ“Š è¯†åˆ«éœ€è¦ä¿æŒrootæ‰€æœ‰æƒçš„æ–‡ä»¶ç±»å‹**

| æ–‡ä»¶ç±»å‹ | è·¯å¾„ç¤ºä¾‹ | ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯root | é£é™©ç­‰çº§ |
|----------|----------|------------------|----------|
| **ç³»ç»Ÿé…ç½®** | `/etc/passwd`, `/etc/shadow` | ç”¨æˆ·è®¤è¯å®‰å…¨ | ğŸ”´ æé«˜ |
| **å¯åŠ¨æ–‡ä»¶** | `/boot/*`, `/etc/fstab` | ç³»ç»Ÿå¯åŠ¨å¿…éœ€ | ğŸ”´ æé«˜ |
| **ç³»ç»ŸæœåŠ¡** | `/etc/systemd/*`, `/etc/init.d/*` | æœåŠ¡æ§åˆ¶æƒé™ | ğŸŸ¡ é«˜ |
| **ç½‘ç»œé…ç½®** | `/etc/network/*`, `/etc/hosts` | ç½‘ç»œå®‰å…¨ | ğŸŸ¡ é«˜ |
| **è®¾å¤‡æ–‡ä»¶** | `/dev/*` | ç¡¬ä»¶è®¿é—®æ§åˆ¶ | ğŸ”´ æé«˜ |

### 4.4 é˜²æ­¢æ„å¤–è½¬ç§»çš„æ–¹æ³•


**ğŸ”’ ä¿æŠ¤ç­–ç•¥1ï¼šä½¿ç”¨æ–‡ä»¶å±æ€§**
```bash
# ç»™é‡è¦æ–‡ä»¶è®¾ç½®ä¸å¯å˜å±æ€§
chattr +i /etc/passwd /etc/shadow /etc/sudoers
```

**ğŸ”’ ä¿æŠ¤ç­–ç•¥2ï¼šå®šæœŸå®¡è®¡æ£€æŸ¥**
```bash
# æ£€æŸ¥érootç”¨æˆ·æ‹¥æœ‰çš„é‡è¦ç³»ç»Ÿæ–‡ä»¶
find /etc -not -user root -type f | head -20
find /usr/bin -not -user root -type f | head -10
```

**ğŸ”’ ä¿æŠ¤ç­–ç•¥3ï¼šå¤‡ä»½å…³é”®æ–‡ä»¶æƒé™**
```bash
# å¤‡ä»½é‡è¦ç›®å½•çš„æƒé™ä¿¡æ¯
getfacl -R /etc > /backup/etc_permissions.backup
ls -laR /etc > /backup/etc_ownership.backup
```

---

## 5. ğŸ”„ æœåŠ¡è´¦æˆ·æƒé™æ··ä¹±é—®é¢˜


### 5.1 ä»€ä¹ˆæ˜¯æœåŠ¡è´¦æˆ·


**ğŸ”¸ æœåŠ¡è´¦æˆ·çš„æ¦‚å¿µ**
æœåŠ¡è´¦æˆ·æ˜¯ä¸ºç‰¹å®šç³»ç»ŸæœåŠ¡åˆ›å»ºçš„ç‰¹æ®Šç”¨æˆ·è´¦æˆ·ï¼Œå®ƒä»¬é€šå¸¸ä¸ç”¨äºç™»å½•ï¼Œåªç”¨äºè¿è¡Œç‰¹å®šçš„æœåŠ¡è¿›ç¨‹ã€‚

**å¸¸è§æœåŠ¡è´¦æˆ·ï¼š**
```bash
# æŸ¥çœ‹ç³»ç»Ÿä¸­çš„æœåŠ¡è´¦æˆ·
grep -E "(www-data|mysql|postfix|nobody)" /etc/passwd
```

**å…¸å‹æœåŠ¡è´¦æˆ·ä¾‹å­ï¼š**
- `www-data`ï¼šWebæœåŠ¡å™¨ä½¿ç”¨
- `mysql`ï¼šMySQLæ•°æ®åº“æœåŠ¡ä½¿ç”¨  
- `postfix`ï¼šé‚®ä»¶æœåŠ¡ä½¿ç”¨
- `nobody`ï¼šæœ€å°æƒé™æœåŠ¡ä½¿ç”¨

### 5.2 æœåŠ¡è´¦æˆ·æƒé™æ··ä¹±çš„å…¸å‹åœºæ™¯


**ğŸš¨ åœºæ™¯1ï¼šWebæœåŠ¡å™¨æƒé™æ··ä¹±**

**æ­£å¸¸çŠ¶æ€ï¼š**
```bash
# Webæ–‡ä»¶åº”è¯¥å±äºwww-data
ls -la /var/www/html/
drwxr-xr-x 2 www-data www-data 4096 Sep 19 10:00 .
-rw-r--r-- 1 www-data www-data  123 Sep 19 10:00 index.html
```

**é”™è¯¯æ“ä½œï¼š**
```bash
# è¯¯å°†Webæ–‡ä»¶æ”¹ä¸ºmysqlç”¨æˆ·æ‰€æœ‰
chown -R mysql:mysql /var/www/html/
```

**é—®é¢˜åæœï¼š**
```
Apache/Nginx â†’ ä»¥www-dataèº«ä»½è¿è¡Œ â†’ å°è¯•è¯»å–æ–‡ä»¶ â†’ æƒé™è¢«æ‹’ç» â†’ 403é”™è¯¯
```

**ğŸš¨ åœºæ™¯2ï¼šæ•°æ®åº“æ–‡ä»¶æƒé™é”™è¯¯**

**å±é™©æ“ä½œï¼š**
```bash
# é”™è¯¯åœ°å°†æ•°æ®åº“æ–‡ä»¶æ”¹ä¸ºwww-dataæ‰€æœ‰
chown -R www-data:www-data /var/lib/mysql/
```

**å®‰å…¨é£é™©åˆ†æï¼š**
```
Webåº”ç”¨æ¼æ´ â†’ è·å¾—www-dataæƒé™ â†’ ç›´æ¥è®¿é—®æ•°æ®åº“æ–‡ä»¶ â†’ æ•°æ®æ³„éœ²
```

### 5.3 æƒé™æ··ä¹±çš„è¯Šæ–­æ–¹æ³•


**ğŸ” è¯Šæ–­æ­¥éª¤1ï¼šæ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€**
```bash
# æŸ¥çœ‹æœåŠ¡è¿è¡Œç”¨æˆ·
ps aux | grep -E "(apache|nginx|mysql|postfix)"
```

**ğŸ” è¯Šæ–­æ­¥éª¤2ï¼šæ£€æŸ¥æ–‡ä»¶æ‰€æœ‰æƒ**
```bash
# æ£€æŸ¥å…³é”®ç›®å½•çš„æ‰€æœ‰æƒ
ls -la /var/www/ /var/lib/mysql/ /var/spool/mail/
```

**ğŸ” è¯Šæ–­æ­¥éª¤3ï¼šæŸ¥çœ‹æœåŠ¡æ—¥å¿—**
```bash
# æŸ¥çœ‹æƒé™ç›¸å…³çš„é”™è¯¯æ—¥å¿—
grep -i "permission denied" /var/log/apache2/error.log
grep -i "access denied" /var/log/mysql/error.log
```

### 5.4 æœåŠ¡è´¦æˆ·æƒé™ä¿®å¤


**ğŸ“ Apache/Nginx WebæœåŠ¡ä¿®å¤**
```bash
# æ¢å¤Webç›®å½•æ­£ç¡®æƒé™
chown -R www-data:www-data /var/www/html/
chown -R www-data:www-data /var/log/apache2/
chmod -R 755 /var/www/html/
```

**ğŸ“ MySQLæ•°æ®åº“æƒé™ä¿®å¤**
```bash
# æ¢å¤æ•°æ®åº“ç›®å½•æƒé™
chown -R mysql:mysql /var/lib/mysql/
chown -R mysql:mysql /var/log/mysql/
chmod 750 /var/lib/mysql/
```

**ğŸ”§ æƒé™ä¿®å¤éªŒè¯**
```bash
# é‡å¯æœåŠ¡å¹¶æ£€æŸ¥çŠ¶æ€
systemctl restart apache2 mysql
systemctl status apache2 mysql
```

---

## 6. ğŸ“ å…³é”®ç›®å½•æ‰€æœ‰æƒé”™è¯¯å½±å“


### 6.1 Linuxç³»ç»Ÿå…³é”®ç›®å½•æ¦‚è§ˆ


**ğŸ—‚ï¸ ç³»ç»Ÿç›®å½•ç»“æ„å›¾**
```
/ï¼ˆæ ¹ç›®å½•ï¼‰
â”œâ”€â”€ /boot          â† ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶
â”œâ”€â”€ /etc           â† ç³»ç»Ÿé…ç½®æ–‡ä»¶
â”œâ”€â”€ /var           â† å˜åŒ–æ•°æ®ï¼ˆæ—¥å¿—ã€ç¼“å­˜ï¼‰
â”œâ”€â”€ /usr           â† ç”¨æˆ·ç¨‹åºå’Œæ•°æ®
â”œâ”€â”€ /opt           â† å¯é€‰ç¨‹åºåŒ…
â”œâ”€â”€ /tmp           â† ä¸´æ—¶æ–‡ä»¶
â”œâ”€â”€ /dev           â† è®¾å¤‡æ–‡ä»¶
â”œâ”€â”€ /proc          â† è¿›ç¨‹ä¿¡æ¯ï¼ˆè™šæ‹Ÿï¼‰
â””â”€â”€ /sys           â† ç³»ç»Ÿä¿¡æ¯ï¼ˆè™šæ‹Ÿï¼‰
```

### 6.2 /bootç›®å½•æ‰€æœ‰æƒé”™è¯¯


**ğŸš¨ å±é™©ç¨‹åº¦ï¼šğŸ”´ æé«˜**

**æ­£å¸¸çŠ¶æ€ï¼š**
```bash
ls -la /boot/
drwxr-xr-x  3 root root  4096 Sep 19 09:15 .
-rw-r--r--  1 root root  8.1M Sep 19 09:15 vmlinuz-5.4.0
-rw-r--r--  1 root root  32M  Sep 19 09:15 initrd.img-5.4.0
```

**é”™è¯¯æ“ä½œåæœï¼š**
```bash
# å¦‚æœæ‰§è¡Œäº†ï¼šchown -R user1:user1 /boot/
```

**ç³»ç»Ÿå¯åŠ¨æµç¨‹ä¸­æ–­ï¼š**
```
BIOS â†’ æŸ¥æ‰¾å¯åŠ¨æ–‡ä»¶ â†’ æƒé™æ£€æŸ¥å¤±è´¥ â†’ å¯åŠ¨ä¸­æ­¢ â†’ ç³»ç»Ÿæ— æ³•å¯åŠ¨
```

**æ¢å¤æ–¹æ³•ï¼š**
1. ä½¿ç”¨æ•‘æ´æ¨¡å¼å¯åŠ¨
2. æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ
3. æ¢å¤bootç›®å½•æƒé™ï¼š`chown -R root:root /boot/`

### 6.3 /devç›®å½•æ‰€æœ‰æƒé”™è¯¯


**ğŸš¨ å±é™©ç¨‹åº¦ï¼šğŸ”´ æé«˜**

**/devç›®å½•çš„ç‰¹æ®Šæ€§ï¼š**
> /devç›®å½•åŒ…å«æ‰€æœ‰è®¾å¤‡æ–‡ä»¶ï¼Œå°±åƒæ˜¯ç³»ç»Ÿç¡¬ä»¶çš„"é¥æ§å™¨"ï¼Œå¦‚æœé¥æ§å™¨è¢«åˆ«äººæ‹¿èµ°ï¼Œç¡¬ä»¶å°±æ— æ³•æ­£å¸¸æ§åˆ¶äº†ã€‚

**è®¾å¤‡æ–‡ä»¶ç¤ºä¾‹ï¼š**
```bash
ls -la /dev/ | head -10
crw-rw-rw- 1 root tty     5,   0 Sep 19 15:30 tty
brw-rw---- 1 root disk    8,   0 Sep 19 15:30 sda
crw------- 1 root root    1,   1 Sep 19 15:30 mem
crw-rw-rw- 1 root root    1,   3 Sep 19 15:30 null
```

**æƒé™é”™è¯¯çš„å½±å“ï¼š**

| è®¾å¤‡æ–‡ä»¶ | æ­£å¸¸æƒé™ | é”™è¯¯æƒé™ | åæœ |
|----------|----------|----------|------|
| `/dev/sda` | `root:disk` | `user1:user1` | ç”¨æˆ·å¯ç›´æ¥è®¿é—®ç¡¬ç›˜ |
| `/dev/mem` | `root:root` | `user1:user1` | ç”¨æˆ·å¯è®¿é—®å†…å­˜ |
| `/dev/tty*` | `root:tty` | `user1:user1` | ç»ˆç«¯è®¿é—®æ··ä¹± |

### 6.4 /tmpç›®å½•æ‰€æœ‰æƒé”™è¯¯


**ğŸ”¸ ç‰¹æ®Šæƒé™ä½è¯´æ˜**

**æ­£å¸¸çš„/tmpç›®å½•æƒé™ï¼š**
```bash
ls -ld /tmp/
drwxrwxrwt 12 root root 4096 Sep 19 15:30 /tmp/
#        â†‘
#    sticky bitï¼ˆç²˜ç€ä½ï¼‰
```

**sticky bitçš„ä½œç”¨ï¼š**
> å°±åƒå…¬å…±å•æ‰€ï¼Œæ¯ä¸ªäººéƒ½èƒ½ä½¿ç”¨ï¼Œä½†åªèƒ½åˆ é™¤è‡ªå·±åˆ›å»ºçš„æ–‡ä»¶ã€‚

**æƒé™ä½è¯¦è§£ï¼š**
- `drwxrwxrwt`ä¸­çš„`t`è¡¨ç¤ºsticky bit
- ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥åœ¨/tmpåˆ›å»ºæ–‡ä»¶
- ä½†åªèƒ½åˆ é™¤è‡ªå·±åˆ›å»ºçš„æ–‡ä»¶

**é”™è¯¯ä¿®æ”¹çš„åæœï¼š**
```bash
# é”™è¯¯æ“ä½œï¼šchown user1:user1 /tmp/
# ç»“æœï¼šæ™®é€šç”¨æˆ·æ§åˆ¶äº†ä¸´æ—¶ç›®å½•
```

**å®‰å…¨é£é™©ï¼š**
- ç”¨æˆ·å¯ä»¥åˆ é™¤ä»–äººçš„ä¸´æ—¶æ–‡ä»¶
- å¯èƒ½å½±å“ç³»ç»Ÿå’Œå…¶ä»–ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶
- ç ´åå¤šç”¨æˆ·ç¯å¢ƒçš„éš”ç¦»æ€§

### 6.5 å…³é”®ç›®å½•æƒé™æ¢å¤æŒ‡å—


**ğŸ“‹ å¿«é€Ÿæ¢å¤å‘½ä»¤é›†**

**ç³»ç»Ÿæ ¸å¿ƒç›®å½•ï¼š**
```bash
chown root:root /boot /etc /usr /opt
chown root:root /dev
chown root:root /tmp && chmod 1777 /tmp
```

**æœåŠ¡ç›¸å…³ç›®å½•ï¼š**
```bash
chown -R www-data:www-data /var/www/
chown -R mysql:mysql /var/lib/mysql/
chown -R syslog:adm /var/log/
```

**éªŒè¯ä¿®å¤ç»“æœï¼š**
```bash
# æ£€æŸ¥å…³é”®ç›®å½•æƒé™æ˜¯å¦æ­£ç¡®
stat /boot /etc /dev /tmp | grep -E "(Uid|Gid|Access)"
```

---

## 7. ğŸ›¡ï¸ æ‰€æœ‰æƒå˜æ›´å®‰å…¨æ£€æŸ¥æœºåˆ¶


### 7.1 æ‰§è¡Œå‰çš„å®‰å…¨æ£€æŸ¥æ¸…å•


**ğŸ“‹ æ“ä½œå‰å¿…æ£€é¡¹ç›®**

**âœ… è·¯å¾„æ£€æŸ¥**
```bash
# 1. ç¡®è®¤ç›®æ ‡è·¯å¾„å­˜åœ¨ä¸”æ­£ç¡®
ls -la /path/to/target
pwd  # ç¡®è®¤å½“å‰ä½ç½®
```

**âœ… ç”¨æˆ·å’Œç»„æ£€æŸ¥**
```bash
# 2. ç¡®è®¤ç›®æ ‡ç”¨æˆ·å’Œç»„å­˜åœ¨
id username
getent group groupname
```

**âœ… å½“å‰æƒé™å¤‡ä»½**
```bash
# 3. å¤‡ä»½å½“å‰æƒé™çŠ¶æ€
ls -laR /target/directory > /backup/before_chown.txt
getfacl -R /target/directory > /backup/before_chown_acl.txt
```

**âœ… å½±å“èŒƒå›´è¯„ä¼°**
```bash
# 4. è¯„ä¼°å°†è¦æ”¹å˜çš„æ–‡ä»¶æ•°é‡
find /target/directory -type f | wc -l
find /target/directory -type d | wc -l
```

### 7.2 å±é™©æ“ä½œçš„é¢„è­¦æœºåˆ¶


**ğŸš¨ è‡ªåŠ¨é¢„è­¦è„šæœ¬**
```bash
#!/bin/bash
# safe_chown.sh - å®‰å…¨çš„chownåŒ…è£…è„šæœ¬

check_dangerous_paths() {
    local path="$1"
    
    # å®šä¹‰å±é™©è·¯å¾„åˆ—è¡¨
    dangerous_paths=("/" "/etc" "/boot" "/dev" "/usr" "/var")
    
    for dangerous in "${dangerous_paths[@]}"; do
        if [[ "$path" == "$dangerous" ]] || [[ "$path" == "$dangerous"/* ]]; then
            echo "âš ï¸  è­¦å‘Šï¼šè¿™æ˜¯ç³»ç»Ÿå…³é”®è·¯å¾„: $path"
            read -p "ç¡®è®¤è¦ç»§ç»­å—ï¼Ÿ(è¾“å…¥ YES ç»§ç»­): " confirm
            if [[ "$confirm" != "YES" ]]; then
                echo "æ“ä½œå·²å–æ¶ˆ"
                exit 1
            fi
        fi
    done
}
```

**ğŸ” é¢„æ£€æŸ¥å‡½æ•°**
```bash
pre_check() {
    local user="$1"
    local group="$2" 
    local path="$3"
    
    # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    if ! id "$user" &>/dev/null; then
        echo "âŒ é”™è¯¯ï¼šç”¨æˆ· $user ä¸å­˜åœ¨"
        exit 1
    fi
    
    # æ£€æŸ¥ç»„æ˜¯å¦å­˜åœ¨
    if ! getent group "$group" &>/dev/null; then
        echo "âŒ é”™è¯¯ï¼šç»„ $group ä¸å­˜åœ¨"
        exit 1
    fi
    
    # æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨
    if [[ ! -e "$path" ]]; then
        echo "âŒ é”™è¯¯ï¼šè·¯å¾„ $path ä¸å­˜åœ¨"
        exit 1
    fi
}
```

### 7.3 åˆ†çº§æƒé™æ£€æŸ¥ç³»ç»Ÿ


**ğŸ“Š é£é™©ç­‰çº§è¯„ä¼°**

| é£é™©ç­‰çº§ | è·¯å¾„æ¨¡å¼ | æ£€æŸ¥è¦æ±‚ | ç¤ºä¾‹è·¯å¾„ |
|----------|----------|----------|----------|
| ğŸ”´ **æé«˜** | `/`, `/etc`, `/boot` | éœ€è¦åŒé‡ç¡®è®¤ | `/etc/passwd` |
| ğŸŸ¡ **é«˜** | `/var/log`, `/usr/local` | éœ€è¦ç¡®è®¤ | `/var/log/apache2/` |
| ğŸŸ¢ **ä¸­** | `/home/*`, `/tmp/*` | æ ‡å‡†æ£€æŸ¥ | `/home/user/docs/` |
| âšª **ä½** | ç”¨æˆ·ç›®å½•å†…å®¹ | åŸºç¡€æ£€æŸ¥ | `/home/user/photos/` |

**ğŸ”§ å®ç°é£é™©æ£€æŸ¥**
```bash
assess_risk() {
    local path="$1"
    
    case "$path" in
        "/" | "/etc"* | "/boot"* | "/dev"*)
            echo "ğŸ”´ æé«˜é£é™©"
            return 4
            ;;
        "/var/log"* | "/usr/local"*)
            echo "ğŸŸ¡ é«˜é£é™©"
            return 3
            ;;
        "/home/"* | "/tmp/"*)
            echo "ğŸŸ¢ ä¸­é£é™©"
            return 2
            ;;
        *)
            echo "âšª ä½é£é™©"
            return 1
            ;;
    esac
}
```

### 7.4 å®‰å…¨chownå·¥å…·å®ç°


**ğŸ› ï¸ å®Œæ•´çš„å®‰å…¨chownè„šæœ¬**
```bash
#!/bin/bash
# secure_chown.sh - ä¼ä¸šçº§å®‰å…¨chownå·¥å…·

secure_chown() {
    local owner="$1"
    local path="$2"
    local recursive="$3"
    
    # æ­¥éª¤1ï¼šé¢„æ£€æŸ¥
    echo "ğŸ” å¼€å§‹å®‰å…¨æ£€æŸ¥..."
    pre_check "$owner" "" "$path"
    
    # æ­¥éª¤2ï¼šé£é™©è¯„ä¼°
    echo "ğŸ“Š è¯„ä¼°æ“ä½œé£é™©..."
    risk_level=$(assess_risk "$path")
    
    # æ­¥éª¤3ï¼šå¤‡ä»½å½“å‰çŠ¶æ€
    echo "ğŸ’¾ å¤‡ä»½å½“å‰æƒé™çŠ¶æ€..."
    backup_dir="/backup/chown_$(date +%Y%m%d_%H%M%S)"
    mkdir -p "$backup_dir"
    ls -laR "$path" > "$backup_dir/before.txt"
    
    # æ­¥éª¤4ï¼šæ‰§è¡Œæ“ä½œ
    echo "âš™ï¸  æ‰§è¡Œchownæ“ä½œ..."
    if [[ "$recursive" == "true" ]]; then
        chown -R "$owner" "$path"
    else
        chown "$owner" "$path"
    fi
    
    # æ­¥éª¤5ï¼šéªŒè¯ç»“æœ
    echo "âœ… éªŒè¯æ“ä½œç»“æœ..."
    ls -laR "$path" > "$backup_dir/after.txt"
    echo "å¤‡ä»½ä¿å­˜åœ¨: $backup_dir"
}
```

---

## 8. ğŸ”§ ç³»ç»Ÿæ–‡ä»¶æ‰€æœ‰æƒæ¢å¤æ–¹æ³•


### 8.1 æ¢å¤æ–¹æ³•æ¦‚è§ˆ


**ğŸ”¸ æ¢å¤ç­–ç•¥åˆ†ç±»**

**æŒ‰æ¢å¤èŒƒå›´ï¼š**
- **å•æ–‡ä»¶æ¢å¤**ï¼šç²¾ç¡®æ¢å¤ç‰¹å®šæ–‡ä»¶
- **ç›®å½•æ¢å¤**ï¼šæ¢å¤æ•´ä¸ªç›®å½•ç»“æ„  
- **ç³»ç»Ÿçº§æ¢å¤**ï¼šå…¨ç³»ç»Ÿæƒé™é‡ç½®

**æŒ‰æ¢å¤æ–¹å¼ï¼š**
- **æ‰‹åŠ¨æ¢å¤**ï¼šé€ä¸ªæ–‡ä»¶æ‰‹åŠ¨ä¿®æ­£
- **è„šæœ¬æ¢å¤**ï¼šä½¿ç”¨é¢„è®¾è„šæœ¬æ‰¹é‡æ¢å¤
- **ç³»ç»Ÿå·¥å…·æ¢å¤**ï¼šä½¿ç”¨åŒ…ç®¡ç†å™¨é‡ç½®

### 8.2 å•æ–‡ä»¶ç²¾ç¡®æ¢å¤


**ğŸ” ç¡®å®šæ­£ç¡®çš„æ–‡ä»¶æƒé™**

**æ–¹æ³•1ï¼šæŸ¥è¯¢åŒ…ç®¡ç†å™¨**
```bash
# Debian/Ubuntuç³»ç»Ÿ
dpkg -L packagename | xargs ls -la
apt-file search filename

# RedHat/CentOSç³»ç»Ÿ  
rpm -ql packagename | xargs ls -la
rpm -qf /path/to/file
```

**æ–¹æ³•2ï¼šå‚è€ƒæ ‡å‡†ç³»ç»Ÿ**
```bash
# åœ¨ç›¸åŒç‰ˆæœ¬çš„æ­£å¸¸ç³»ç»Ÿä¸ŠæŸ¥çœ‹
ssh normal_server "ls -la /etc/passwd"
# è¾“å‡ºï¼š-rw-r--r-- 1 root root 2847 Sep 19 10:30 /etc/passwd
```

**æ–¹æ³•3ï¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤å€¼**
```bash
# å¸¸è§ç³»ç»Ÿæ–‡ä»¶çš„æ ‡å‡†æƒé™
chown root:root /etc/passwd && chmod 644 /etc/passwd
chown root:shadow /etc/shadow && chmod 640 /etc/shadow  
chown root:root /etc/sudoers && chmod 440 /etc/sudoers
```

### 8.3 æ‰¹é‡æ¢å¤è„šæœ¬


**ğŸ“ ç³»ç»Ÿæ–‡ä»¶æƒé™æ¢å¤è„šæœ¬**
```bash
#!/bin/bash
# restore_system_permissions.sh

restore_etc_permissions() {
    echo "ğŸ”§ æ¢å¤ /etc ç›®å½•å…³é”®æ–‡ä»¶æƒé™..."
    
    # ç”¨æˆ·è®¤è¯ç›¸å…³æ–‡ä»¶
    chown root:root /etc/passwd && chmod 644 /etc/passwd
    chown root:shadow /etc/shadow && chmod 640 /etc/shadow
    chown root:root /etc/group && chmod 644 /etc/group
    chown root:shadow /etc/gshadow && chmod 640 /etc/gshadow
    
    # ç³»ç»Ÿé…ç½®æ–‡ä»¶
    chown root:root /etc/sudoers && chmod 440 /etc/sudoers
    chown root:root /etc/fstab && chmod 644 /etc/fstab
    chown root:root /etc/hosts && chmod 644 /etc/hosts
    
    echo "âœ… /etc ç›®å½•æƒé™æ¢å¤å®Œæˆ"
}

restore_var_permissions() {
    echo "ğŸ”§ æ¢å¤ /var ç›®å½•æƒé™..."
    
    # æ—¥å¿—ç›®å½•
    chown -R syslog:adm /var/log/
    chmod 755 /var/log/
    
    # Webç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if [[ -d /var/www ]]; then
        chown -R www-data:www-data /var/www/
    fi
    
    # æ•°æ®åº“ç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if [[ -d /var/lib/mysql ]]; then
        chown -R mysql:mysql /var/lib/mysql/
    fi
    
    echo "âœ… /var ç›®å½•æƒé™æ¢å¤å®Œæˆ"
}
```

### 8.4 ä½¿ç”¨åŒ…ç®¡ç†å™¨æ¢å¤


**ğŸ”¸ Debian/Ubuntuç³»ç»Ÿæ¢å¤**
```bash
# é‡æ–°å®‰è£…åŒ…æ¥æ¢å¤æƒé™
apt-get update
apt-get --reinstall install base-passwd
apt-get --reinstall install login
apt-get --reinstall install sudo

# ä¿®å¤åŒ…æƒé™
dpkg --configure -a
apt-get -f install
```

**ğŸ”¸ RedHat/CentOSç³»ç»Ÿæ¢å¤**
```bash
# ä½¿ç”¨rpmé‡ç½®æ–‡ä»¶æƒé™
rpm --setperms setup
rpm --setperms filesystem
rpm --setperms shadow-utils

# é‡æ–°å®‰è£…å…³é”®åŒ…
yum reinstall setup filesystem shadow-utils
```

### 8.5 æ•‘æ´æ¨¡å¼æ¢å¤


**ğŸš¨ ç³»ç»Ÿæ— æ³•å¯åŠ¨æ—¶çš„æ¢å¤æ­¥éª¤**

**æ­¥éª¤1ï¼šå¯åŠ¨æ•‘æ´æ¨¡å¼**
```bash
# åœ¨GRUBå¯åŠ¨èœå•é€‰æ‹©æ•‘æ´æ¨¡å¼
# æˆ–ä½¿ç”¨Live CD/USBå¯åŠ¨
```

**æ­¥éª¤2ï¼šæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ**
```bash
# æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ
mount /dev/sda1 /mnt

# æŒ‚è½½å…¶ä»–å¿…è¦æ–‡ä»¶ç³»ç»Ÿ
mount --bind /dev /mnt/dev
mount --bind /proc /mnt/proc  
mount --bind /sys /mnt/sys
```

**æ­¥éª¤3ï¼šåˆ‡æ¢åˆ°ç³»ç»Ÿç¯å¢ƒ**
```bash
# åˆ‡æ¢æ ¹ç›®å½•
chroot /mnt
```

**æ­¥éª¤4ï¼šæ¢å¤å…³é”®æƒé™**
```bash
# æ¢å¤æœ€åŸºæœ¬çš„æƒé™
chown root:root /etc/passwd /etc/shadow /etc/group
chown root:root /boot/ /etc/ /usr/
chmod 644 /etc/passwd
chmod 640 /etc/shadow
```

**æ­¥éª¤5ï¼šé‡å¯éªŒè¯**
```bash
# é€€å‡ºchrootç¯å¢ƒ
exit

# å¸è½½æ–‡ä»¶ç³»ç»Ÿ
umount /mnt/dev /mnt/proc /mnt/sys /mnt

# é‡å¯ç³»ç»Ÿ
reboot
```

---

## 9. ğŸ“Š æ‰€æœ‰æƒå®¡è®¡æœ€ä½³å®è·µ


### 9.1 å®šæœŸå®¡è®¡çš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦å®šæœŸå®¡è®¡**

**å®‰å…¨åŸå› ï¼š**
- åŠæ—¶å‘ç°æœªæˆæƒçš„æƒé™å˜æ›´
- è¯†åˆ«æ½œåœ¨çš„å®‰å…¨æ¼æ´
- ç¡®ä¿ç³»ç»Ÿç¬¦åˆå®‰å…¨ç­–ç•¥

**åˆè§„åŸå› ï¼š**
- æ»¡è¶³å®‰å…¨å®¡è®¡è¦æ±‚
- ç¬¦åˆè¡Œä¸šå®‰å…¨æ ‡å‡†
- æä¾›å˜æ›´è·Ÿè¸ªè®°å½•

**è¿ç»´åŸå› ï¼š**
- é˜²æ­¢ç³»ç»Ÿæ•…éšœ
- æé«˜æ•…éšœæ’é™¤æ•ˆç‡
- ç»´æŠ¤ç³»ç»Ÿç¨³å®šæ€§

### 9.2 æ‰€æœ‰æƒå®¡è®¡æ£€æŸ¥é¡¹ç›®


**ğŸ“‹ æ ¸å¿ƒæ£€æŸ¥æ¸…å•**

**ç³»ç»Ÿå…³é”®æ–‡ä»¶æ£€æŸ¥ï¼š**
```bash
#!/bin/bash
# ownership_audit.sh

audit_critical_files() {
    echo "ğŸ” å®¡è®¡ç³»ç»Ÿå…³é”®æ–‡ä»¶æ‰€æœ‰æƒ..."
    
    critical_files=(
        "/etc/passwd:root:root"
        "/etc/shadow:root:shadow" 
        "/etc/sudoers:root:root"
        "/etc/fstab:root:root"
        "/boot/vmlinuz:root:root"
        "/usr/bin/sudo:root:root"
    )
    
    for file_info in "${critical_files[@]}"; do
        IFS=':' read -r file expected_user expected_group <<< "$file_info"
        
        if [[ -e "$file" ]]; then
            actual_owner=$(stat -c '%U:%G' "$file")
            expected_owner="${expected_user}:${expected_group}"
            
            if [[ "$actual_owner" != "$expected_owner" ]]; then
                echo "âš ï¸  æƒé™å¼‚å¸¸: $file"
                echo "   é¢„æœŸ: $expected_owner"
                echo "   å®é™…: $actual_owner"
            fi
        fi
    done
}
```

**ç›®å½•æƒé™æ£€æŸ¥ï¼š**
```bash
audit_critical_directories() {
    echo "ğŸ” å®¡è®¡å…³é”®ç›®å½•æ‰€æœ‰æƒ..."
    
    # æ£€æŸ¥æ˜¯å¦æœ‰érootç”¨æˆ·æ‹¥æœ‰ç³»ç»Ÿç›®å½•
    find /etc /boot /usr/bin /usr/sbin -not -user root -type f 2>/dev/null | \
    while read -r file; do
        echo "âš ï¸  ç³»ç»Ÿæ–‡ä»¶érootæ‰€æœ‰: $file ($(stat -c '%U:%G' "$file"))"
    done
}
```

### 9.3 è‡ªåŠ¨åŒ–å®¡è®¡ç³»ç»Ÿ


**ğŸ¤– å®šæ—¶å®¡è®¡è„šæœ¬**
```bash
#!/bin/bash
# daily_ownership_audit.sh

# é…ç½®å˜é‡
AUDIT_LOG="/var/log/ownership_audit.log"
EMAIL="admin@company.com"
DATE=$(date '+%Y-%m-%d %H:%M:%S')

# ä¸»å®¡è®¡å‡½æ•°
run_audit() {
    echo "[$DATE] å¼€å§‹æ‰€æœ‰æƒå®¡è®¡" >> "$AUDIT_LOG"
    
    # æ£€æŸ¥å¼‚å¸¸æƒé™
    local anomalies=0
    
    # 1. æ£€æŸ¥rootæƒé™æ–‡ä»¶
    while IFS= read -r file; do
        echo "[$DATE] è­¦å‘Š: érootç”¨æˆ·æ‹¥æœ‰ç³»ç»Ÿæ–‡ä»¶ $file" >> "$AUDIT_LOG"
        ((anomalies++))
    done < <(find /etc /boot -not -user root -type f 2>/dev/null)
    
    # 2. æ£€æŸ¥æœåŠ¡è´¦æˆ·æ–‡ä»¶
    if [[ -d /var/www ]]; then
        while IFS= read -r file; do
            if [[ $(stat -c '%U' "$file") != "www-data" ]]; then
                echo "[$DATE] è­¦å‘Š: Webæ–‡ä»¶æƒé™å¼‚å¸¸ $file" >> "$AUDIT_LOG"
                ((anomalies++))
            fi
        done < <(find /var/www -type f 2>/dev/null)
    fi
    
    # 3. ç”ŸæˆæŠ¥å‘Š
    echo "[$DATE] å®¡è®¡å®Œæˆï¼Œå‘ç° $anomalies ä¸ªå¼‚å¸¸" >> "$AUDIT_LOG"
    
    # å¦‚æœæœ‰å¼‚å¸¸ï¼Œå‘é€é‚®ä»¶
    if [[ $anomalies -gt 0 ]]; then
        tail -50 "$AUDIT_LOG" | mail -s "ç³»ç»Ÿæƒé™å¼‚å¸¸æŠ¥å‘Š" "$EMAIL"
    fi
}

# æ‰§è¡Œå®¡è®¡
run_audit
```

**ğŸ“… è®¾ç½®å®šæ—¶ä»»åŠ¡**
```bash
# æ·»åŠ åˆ°crontab
crontab -e

# æ¯æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå®¡è®¡
0 2 * * * /usr/local/bin/daily_ownership_audit.sh

# æ¯å‘¨ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
0 3 * * 1 /usr/local/bin/weekly_ownership_report.sh
```

### 9.4 å®¡è®¡ç»“æœåˆ†æ


**ğŸ“ˆ å»ºç«‹åŸºçº¿å’Œè¶‹åŠ¿åˆ†æ**

**åŸºçº¿å»ºç«‹ï¼š**
```bash
# å»ºç«‹ç³»ç»Ÿæƒé™åŸºçº¿
find /etc /boot /usr -type f -exec stat -c '%n:%U:%G:%a' {} \; > /baseline/permissions_baseline.txt

# å®šæœŸä¸åŸºçº¿å¯¹æ¯”
find /etc /boot /usr -type f -exec stat -c '%n:%U:%G:%a' {} \; > /tmp/current_permissions.txt
diff /baseline/permissions_baseline.txt /tmp/current_permissions.txt > /tmp/permission_changes.txt
```

**å˜æ›´è¿½è¸ªï¼š**
```bash
#!/bin/bash
# track_permission_changes.sh

track_changes() {
    local current_file="/tmp/current_permissions.txt"
    local baseline_file="/baseline/permissions_baseline.txt"
    local changes_file="/var/log/permission_changes_$(date +%Y%m%d).log"
    
    # ç”Ÿæˆå½“å‰æƒé™å¿«ç…§
    find /etc /boot /usr -type f -exec stat -c '%n:%U:%G:%a' {} \; > "$current_file"
    
    # ä¸åŸºçº¿å¯¹æ¯”
    if [[ -f "$baseline_file" ]]; then
        diff "$baseline_file" "$current_file" | grep -E '^[<>]' > "$changes_file"
        
        if [[ -s "$changes_file" ]]; then
            echo "å‘ç°æƒé™å˜æ›´ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹: $changes_file"
            # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é‚®ä»¶é€šçŸ¥
        fi
    fi
}
```

### 9.5 å®¡è®¡æŠ¥å‘Šæ¨¡æ¿


**ğŸ“„ ç”Ÿæˆç»“æ„åŒ–å®¡è®¡æŠ¥å‘Š**
```bash
#!/bin/bash
# generate_audit_report.sh

generate_html_report() {
    local report_file="/var/www/html/audit_report_$(date +%Y%m%d).html"
    
    cat > "$report_file" << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <title>ç³»ç»Ÿæƒé™å®¡è®¡æŠ¥å‘Š</title>
    <style>
        .warning { color: red; }
        .ok { color: green; }
        table { border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; }
    </style>
</head>
<body>
    <h1>ç³»ç»Ÿæƒé™å®¡è®¡æŠ¥å‘Š</h1>
    <p>ç”Ÿæˆæ—¶é—´: $(date)</p>
    
    <h2>å®¡è®¡æ‘˜è¦</h2>
    <table>
        <tr><th>æ£€æŸ¥é¡¹ç›®</th><th>çŠ¶æ€</th><th>å¼‚å¸¸æ•°é‡</th></tr>
EOF

    # æ·»åŠ å®¡è®¡ç»“æœæ•°æ®
    local system_files_ok=$(check_system_files_count)
    local web_files_ok=$(check_web_files_count)
    
    cat >> "$report_file" << EOF
        <tr><td>ç³»ç»Ÿå…³é”®æ–‡ä»¶</td><td class="ok">æ­£å¸¸</td><td>$system_files_ok</td></tr>
        <tr><td>WebæœåŠ¡æ–‡ä»¶</td><td class="ok">æ­£å¸¸</td><td>$web_files_ok</td></tr>
    </table>
</body>
</html>
EOF

    echo "å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ chownåŸºç¡€ï¼šæ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…çš„å‘½ä»¤ï¼Œå½±å“ç³»ç»Ÿå®‰å…¨
ğŸ”¸ é€’å½’é£é™©ï¼š-Rå‚æ•°å¯èƒ½å¯¼è‡´å¤§èŒƒå›´æƒé™é”™è¯¯
ğŸ”¸ ç³»ç»Ÿæ–‡ä»¶ï¼šæŸäº›æ–‡ä»¶å¿…é¡»ä¿æŒrootæ‰€æœ‰æƒ
ğŸ”¸ æœåŠ¡è´¦æˆ·ï¼šä¸åŒæœåŠ¡éœ€è¦ç‰¹å®šçš„ç”¨æˆ·æƒé™
ğŸ”¸ å…³é”®ç›®å½•ï¼š/etcã€/bootã€/devç­‰ç›®å½•æƒé™è‡³å…³é‡è¦
ğŸ”¸ å®‰å…¨æ£€æŸ¥ï¼šæ“ä½œå‰å¿…é¡»è¿›è¡Œå……åˆ†çš„å®‰å…¨è¯„ä¼°
ğŸ”¸ æ¢å¤æ–¹æ³•ï¼šæŒæ¡å¤šç§æƒé™æ¢å¤æŠ€æœ¯
ğŸ”¸ å®¡è®¡å®è·µï¼šå®šæœŸæ£€æŸ¥å’Œç›‘æ§æƒé™å˜åŒ–
```

### 10.2 å…³é”®å®‰å…¨åŸåˆ™


**ğŸ”¹ æœ€å°æƒé™åŸåˆ™**
```
æ ¸å¿ƒæ€æƒ³ï¼šç»™äºˆæœ€å°å¿…è¦æƒé™
å®é™…åº”ç”¨ï¼š
- ç³»ç»Ÿæ–‡ä»¶ä¿æŒrootæ‰€æœ‰æƒ
- æœåŠ¡è´¦æˆ·åªæ§åˆ¶ç›¸å…³æ–‡ä»¶
- æ™®é€šç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ–‡ä»¶
```

**ğŸ”¹ é˜²å¾¡æ€§æ“ä½œ**
```
æ“ä½œå‰ä¸‰æ­¥ï¼š
1. ğŸ” æ£€æŸ¥è·¯å¾„å’Œå‚æ•°
2. ğŸ’¾ å¤‡ä»½å½“å‰çŠ¶æ€  
3. âš¡ è¯„ä¼°å½±å“èŒƒå›´

æ“ä½œä¸­ï¼š
- ä½¿ç”¨ç»å¯¹è·¯å¾„
- é€æ­¥éªŒè¯ç»“æœ
- ç›‘æ§ç³»ç»ŸçŠ¶æ€

æ“ä½œåï¼š
- éªŒè¯åŠŸèƒ½æ­£å¸¸
- è®°å½•å˜æ›´æ—¥å¿—
- å»ºç«‹ç›‘æ§å‘Šè­¦
```

**ğŸ”¹ å¿«é€Ÿæ¢å¤å‡†å¤‡**
```
é¢„é˜²æªæ–½ï¼š
- å»ºç«‹æƒé™åŸºçº¿
- å®šæœŸå¤‡ä»½æƒé™çŠ¶æ€
- å‡†å¤‡æ¢å¤è„šæœ¬
- æµ‹è¯•æ¢å¤æµç¨‹
```

### 10.3 å®è·µåº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ—¥å¸¸è¿ç»´å»ºè®®**

**å®‰å…¨æ£€æŸ¥æ¸…å•ï¼š**
- [ ] æ“ä½œå‰ç¡®è®¤è·¯å¾„æ­£ç¡®
- [ ] æ£€æŸ¥ç›®æ ‡ç”¨æˆ·å’Œç»„å­˜åœ¨
- [ ] è¯„ä¼°æ“ä½œå½±å“èŒƒå›´
- [ ] å¤‡ä»½å½“å‰æƒé™çŠ¶æ€
- [ ] ä½¿ç”¨å®‰å…¨åŒ…è£…è„šæœ¬

**åº”æ€¥å¤„ç†æµç¨‹ï¼š**
1. **ç«‹å³è¯„ä¼°å½±å“**ï¼šç¡®å®šå—å½±å“çš„ç³»ç»Ÿå’ŒæœåŠ¡
2. **ä¼˜å…ˆæ¢å¤å…³é”®æœåŠ¡**ï¼šå…ˆæ¢å¤ç³»ç»Ÿå¯åŠ¨å’Œç™»å½•åŠŸèƒ½  
3. **é€æ­¥ä¿®å¤å…¶ä»–é—®é¢˜**ï¼šæŒ‰é‡è¦æ€§é¡ºåºæ¢å¤å…¶ä»–æƒé™
4. **éªŒè¯ç³»ç»ŸåŠŸèƒ½**ï¼šç¡®è®¤æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ
5. **è®°å½•äº‹ä»¶å’Œæ”¹è¿›**ï¼šæ€»ç»“ç»éªŒï¼Œå®Œå–„é¢„é˜²æªæ–½

**ğŸ”§ å·¥å…·å’Œè„šæœ¬æ¨è**

**å¿…å¤‡å·¥å…·ï¼š**
- `stat`ï¼šæŸ¥çœ‹è¯¦ç»†æƒé™ä¿¡æ¯
- `find`ï¼šæ‰¹é‡æŸ¥æ‰¾æƒé™å¼‚å¸¸æ–‡ä»¶
- `getfacl/setfacl`ï¼šå¤„ç†å¤æ‚æƒé™
- è‡ªå®šä¹‰å®‰å…¨åŒ…è£…è„šæœ¬

**ç›‘æ§æŒ‡æ ‡ï¼š**
- ç³»ç»Ÿå…³é”®æ–‡ä»¶æƒé™å˜åŒ–
- æœåŠ¡è´¦æˆ·æƒé™å¼‚å¸¸
- éæˆæƒçš„æƒé™æå‡
- æƒé™å˜æ›´é¢‘ç‡å’Œæ¨¡å¼

### 10.4 å­¦ä¹ æå‡è·¯å¾„


**ğŸ“š è¿›é˜¶å­¦ä¹ å»ºè®®**

**åŸºç¡€å·©å›ºï¼š**
- æ·±å…¥ç†è§£Linuxæƒé™æ¨¡å‹
- æŒæ¡ç”¨æˆ·å’Œç»„ç®¡ç†
- ç†Ÿæ‚‰æ–‡ä»¶ç³»ç»Ÿæƒé™æœºåˆ¶

**å®è·µæå‡ï¼š**  
- æ­å»ºæµ‹è¯•ç¯å¢ƒç»ƒä¹ 
- æ¨¡æ‹Ÿå„ç§é”™è¯¯åœºæ™¯
- ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬
- å‚ä¸æƒé™å®¡è®¡é¡¹ç›®

**é«˜çº§æŠ€èƒ½ï¼š**
- SELinux/AppArmorå®‰å…¨å¢å¼º
- LDAP/ADåŸŸç¯å¢ƒæƒé™ç®¡ç†  
- å®¹å™¨ç¯å¢ƒæƒé™æ§åˆ¶
- äº‘ç¯å¢ƒæƒé™ç­–ç•¥

**ğŸ”¥ è®°å¿†å£è¯€**
> æƒé™å˜æ›´éœ€è°¨æ…ï¼Œè·¯å¾„ç”¨æˆ·å…ˆç¡®è®¤  
> ç³»ç»Ÿæ–‡ä»¶å½’rootç®¡ï¼ŒæœåŠ¡è´¦æˆ·å„å¸æƒ  
> é€’å½’æ“ä½œé£é™©å¤§ï¼Œå¤‡ä»½æ£€æŸ¥ä¸èƒ½å…  
> å®šæœŸå®¡è®¡å»ºåŸºçº¿ï¼Œå®‰å…¨è¿ç»´ä¿å¹³å®‰

**æ ¸å¿ƒç†å¿µ**ï¼š
- chownæ˜¯å¼ºå¤§çš„å·¥å…·ï¼Œä½†éœ€è¦è°¨æ…ä½¿ç”¨
- æƒé™é”™è¯¯å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œé¢„é˜²èƒœäºæ²»ç–—
- å»ºç«‹å®Œå–„çš„æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶æ˜¯è¿ç»´çš„åŸºæœ¬è¦æ±‚
- å®‰å…¨æ„è¯†æ¯”æŠ€æœ¯æŠ€å·§æ›´é‡è¦

ğŸ’¡ **æœ€ç»ˆå»ºè®®**
åœ¨å®é™…å·¥ä½œä¸­ï¼Œå»ºè®®å°†chownæ“ä½œçº³å…¥å˜æ›´ç®¡ç†æµç¨‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒçš„ç³»ç»Ÿæ–‡ä»¶æƒé™å˜æ›´ï¼Œå¿…é¡»ç»è¿‡å……åˆ†çš„æµ‹è¯•å’Œå®¡æ‰¹ã€‚åŒæ—¶ï¼Œå»ºç«‹è‡ªåŠ¨åŒ–çš„æƒé™ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶ï¼Œèƒ½å¤Ÿåœ¨æƒé™å¼‚å¸¸æ—¶åŠæ—¶å‘ç°å’Œå¤„ç†ã€‚