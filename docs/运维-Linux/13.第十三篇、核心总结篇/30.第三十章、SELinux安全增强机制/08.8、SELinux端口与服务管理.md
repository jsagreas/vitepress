---
title: 8ã€SELinuxç«¯å£ä¸æœåŠ¡ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ç«¯å£æ ‡ç­¾æ¦‚å¿µä¸ä½œç”¨](#1-ç«¯å£æ ‡ç­¾æ¦‚å¿µä¸ä½œç”¨)
2. [semanage portç«¯å£ç®¡ç†](#2-semanage-portç«¯å£ç®¡ç†)
3. [æœåŠ¡ç«¯å£ç±»å‹å®šä¹‰](#3-æœåŠ¡ç«¯å£ç±»å‹å®šä¹‰)
4. [éæ ‡å‡†ç«¯å£çš„SELinuxé…ç½®](#4-éæ ‡å‡†ç«¯å£çš„selinuxé…ç½®)
5. [ç½‘ç»œæœåŠ¡SELinuxç­–ç•¥](#5-ç½‘ç»œæœåŠ¡selinuxç­–ç•¥)
6. [ç«¯å£è®¿é—®æ§åˆ¶è§„åˆ™](#6-ç«¯å£è®¿é—®æ§åˆ¶è§„åˆ™)
7. [æœåŠ¡å¯åŠ¨å¤±è´¥çš„SELinuxæ’æŸ¥](#7-æœåŠ¡å¯åŠ¨å¤±è´¥çš„selinuxæ’æŸ¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ·ï¸ ç«¯å£æ ‡ç­¾æ¦‚å¿µä¸ä½œç”¨


### 1.1 ä»€ä¹ˆæ˜¯ç«¯å£æ ‡ç­¾


**ç«¯å£æ ‡ç­¾çš„æœ¬è´¨**ï¼š
```
ç«¯å£æ ‡ç­¾ = ç»™æ¯ä¸ªç½‘ç»œç«¯å£è´´ä¸Šä¸€ä¸ª"èº«ä»½è¯"
å°±åƒç»™æ¯ä¸ªé—¨ç‰Œå·æ ‡æ³¨"è¿™é‡Œä½çš„æ˜¯ä»€ä¹ˆäºº"

ä¾‹å­ç±»æ¯”ï¼š
ç‰©ç†ä¸–ç•Œï¼š80å·é—¨ç‰Œ â†’ "è¿™é‡Œæ˜¯HTTPç½‘ç«™"
SELinuxï¼š80ç«¯å£ â†’ "http_port_tç±»å‹"
```

**ä¸ºä»€ä¹ˆéœ€è¦ç«¯å£æ ‡ç­¾**ï¼š
- **èº«ä»½è¯†åˆ«**ï¼šSELinuxéœ€è¦çŸ¥é“ç«¯å£æ˜¯å¹²ä»€ä¹ˆç”¨çš„
- **è®¿é—®æ§åˆ¶**ï¼šåªæœ‰åˆé€‚çš„æœåŠ¡æ‰èƒ½ä½¿ç”¨å¯¹åº”çš„ç«¯å£
- **å®‰å…¨é˜²æŠ¤**ï¼šé˜²æ­¢æ¶æ„ç¨‹åºéšæ„å ç”¨é‡è¦ç«¯å£

### 1.2 ç«¯å£æ ‡ç­¾çš„å·¥ä½œæœºåˆ¶


**å·¥ä½œåŸç†å›¾ç¤º**ï¼š
```
åº”ç”¨ç¨‹åºæƒ³ä½¿ç”¨ç«¯å£
        â†“
SELinuxæ£€æŸ¥ç¨‹åºæ ‡ç­¾å’Œç«¯å£æ ‡ç­¾
        â†“
    æ ‡ç­¾åŒ¹é…å—ï¼Ÿ
   â†™        â†˜
 åŒ¹é…        ä¸åŒ¹é…
å…è®¸ä½¿ç”¨    â†’ æ‹’ç»è®¿é—®
```

**å®é™…æ¡ˆä¾‹**ï¼š
```
åœºæ™¯ï¼šApacheæƒ³ä½¿ç”¨80ç«¯å£

æ£€æŸ¥è¿‡ç¨‹ï¼š
1. Apacheè¿›ç¨‹æ ‡ç­¾ï¼šhttpd_t
2. 80ç«¯å£æ ‡ç­¾ï¼šhttp_port_t  
3. SELinuxç­–ç•¥ï¼šhttpd_tå¯ä»¥ä½¿ç”¨http_port_t
4. ç»“æœï¼šå…è®¸ç»‘å®š

åœºæ™¯ï¼šSSHæƒ³ä½¿ç”¨80ç«¯å£
1. SSHè¿›ç¨‹æ ‡ç­¾ï¼šsshd_t
2. 80ç«¯å£æ ‡ç­¾ï¼šhttp_port_t
3. SELinuxç­–ç•¥ï¼šsshd_tä¸èƒ½ä½¿ç”¨http_port_t
4. ç»“æœï¼šæ‹’ç»ç»‘å®š
```

### 1.3 ç«¯å£æ ‡ç­¾çš„ç±»å‹åˆ†ç±»


**å¸¸è§ç«¯å£ç±»å‹**ï¼š

| ç«¯å£ç±»å‹ | **å¯¹åº”æœåŠ¡** | **é»˜è®¤ç«¯å£** | **ç”¨é€”è¯´æ˜** |
|---------|------------|-------------|-------------|
| `http_port_t` | `Apache/Nginx` | `80, 443, 8080` | `ç½‘é¡µæœåŠ¡` |
| `ssh_port_t` | `SSH` | `22` | `è¿œç¨‹ç™»å½•` |
| `smtp_port_t` | `é‚®ä»¶æœåŠ¡` | `25, 587` | `é‚®ä»¶å‘é€` |
| `dns_port_t` | `DNSæœåŠ¡` | `53` | `åŸŸåè§£æ` |
| `mysql_port_t` | `MySQLæ•°æ®åº“` | `3306` | `æ•°æ®åº“æœåŠ¡` |

---

## 2. ğŸ› ï¸ semanage portç«¯å£ç®¡ç†


### 2.1 æŸ¥çœ‹ç«¯å£æ ‡ç­¾


**æŸ¥çœ‹æ‰€æœ‰ç«¯å£æ ‡ç­¾**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰ç«¯å£æ ‡ç­¾
semanage port -l

# åªçœ‹HTTPç›¸å…³ç«¯å£
semanage port -l | grep http
```

**æŸ¥çœ‹ç‰¹å®šç«¯å£**ï¼š
```bash
# æŸ¥çœ‹80ç«¯å£æ ‡ç­¾
semanage port -l | grep ":80 "

# æŸ¥çœ‹8080ç«¯å£æ ‡ç­¾  
semanage port -l | grep ":8080"
```

> **ğŸ’¡ å®ç”¨æŠ€å·§**ï¼šä½¿ç”¨`grep ":ç«¯å£å· "`ï¼ˆæ³¨æ„ç©ºæ ¼ï¼‰ï¼Œå¯ä»¥ç²¾ç¡®åŒ¹é…ç«¯å£å·ï¼Œé¿å…åŒ¹é…åˆ°åŒ…å«è¯¥æ•°å­—çš„å…¶ä»–ç«¯å£

### 2.2 æ·»åŠ ç«¯å£æ ‡ç­¾


**åŸºæœ¬è¯­æ³•**ï¼š
```bash
semanage port -a -t æ ‡ç­¾ç±»å‹ -p åè®® ç«¯å£å·
```

**å®é™…æ“ä½œç¤ºä¾‹**ï¼š
```bash
# ç»™8090ç«¯å£æ·»åŠ HTTPæ ‡ç­¾
semanage port -a -t http_port_t -p tcp 8090

# ç»™2222ç«¯å£æ·»åŠ SSHæ ‡ç­¾
semanage port -a -t ssh_port_t -p tcp 2222

# ç»™8443ç«¯å£æ·»åŠ HTTPSæ ‡ç­¾
semanage port -a -t http_port_t -p tcp 8443
```

**å‚æ•°è¯´æ˜**ï¼š
- `-a`ï¼šæ·»åŠ ï¼ˆaddï¼‰
- `-t`ï¼šæŒ‡å®šç±»å‹ï¼ˆtypeï¼‰
- `-p`ï¼šæŒ‡å®šåè®®ï¼ˆprotocolï¼‰ï¼Œé€šå¸¸æ˜¯tcpæˆ–udp

### 2.3 åˆ é™¤ç«¯å£æ ‡ç­¾


**åˆ é™¤è‡ªå®šä¹‰ç«¯å£æ ‡ç­¾**ï¼š
```bash
# åˆ é™¤8090çš„HTTPæ ‡ç­¾
semanage port -d -t http_port_t -p tcp 8090

# åˆ é™¤2222çš„SSHæ ‡ç­¾
semanage port -d -t ssh_port_t -p tcp 2222
```

> **âš ï¸ é‡è¦æé†’**ï¼šåªèƒ½åˆ é™¤è‡ªå·±æ·»åŠ çš„ç«¯å£æ ‡ç­¾ï¼Œç³»ç»Ÿé»˜è®¤çš„ç«¯å£æ ‡ç­¾ä¸èƒ½åˆ é™¤

### 2.4 ä¿®æ”¹ç«¯å£æ ‡ç­¾


**ä¿®æ”¹ç°æœ‰ç«¯å£æ ‡ç­¾**ï¼š
```bash
# ä¿®æ”¹8080ç«¯å£ä»HTTPæ”¹ä¸ºå…¶ä»–ç±»å‹
semanage port -m -t http_cache_port_t -p tcp 8080
```

**ä¿®æ”¹æ“ä½œçš„æ³¨æ„äº‹é¡¹**ï¼š
- ä¿®æ”¹å‰å…ˆç¡®è®¤å½“å‰æ ‡ç­¾ç±»å‹
- ç¡®ä¿æ–°æ ‡ç­¾ç±»å‹é€‚åˆå¯¹åº”çš„æœåŠ¡
- ä¿®æ”¹åå¯èƒ½éœ€è¦é‡å¯ç›¸å…³æœåŠ¡

---

## 3. ğŸ—ï¸ æœåŠ¡ç«¯å£ç±»å‹å®šä¹‰


### 3.1 ç†è§£æœåŠ¡ä¸ç«¯å£çš„å¯¹åº”å…³ç³»


**ä¸€å¯¹ä¸€å…³ç³»**ï¼š
```
SSHæœåŠ¡ â†â†’ ssh_port_t â†â†’ 22ç«¯å£
```

**ä¸€å¯¹å¤šå…³ç³»**ï¼š
```
HTTPæœåŠ¡ â†â†’ http_port_t â†â†’ 80, 443, 8080, 8443ç«¯å£
```

**å¤šå¯¹ä¸€å…³ç³»**ï¼ˆè¾ƒå°‘è§ï¼‰ï¼š
```
æŸäº›å¤åˆæœåŠ¡å¯èƒ½éœ€è¦å¤šç§ç«¯å£ç±»å‹
```

### 3.2 æŸ¥çœ‹æœåŠ¡å¯¹åº”çš„ç«¯å£ç±»å‹


**æŸ¥çœ‹å…·ä½“æœåŠ¡å…è®¸ä½¿ç”¨çš„ç«¯å£**ï¼š
```bash
# æŸ¥çœ‹Apacheå¯ä»¥ä½¿ç”¨å“ªäº›ç«¯å£
sesearch -A -s httpd_t -c tcp_socket -p name_bind

# æŸ¥çœ‹SSHå¯ä»¥ä½¿ç”¨å“ªäº›ç«¯å£
sesearch -A -s sshd_t -c tcp_socket -p name_bind
```

**ç†è§£è¾“å‡ºç»“æœ**ï¼š
```
è¾“å‡ºç¤ºä¾‹ï¼š
allow httpd_t http_port_t:tcp_socket name_bind;

è§£è¯»ï¼š
- httpd_tï¼ˆApacheè¿›ç¨‹ï¼‰
- å¯ä»¥ç»‘å®šï¼ˆname_bindï¼‰
- http_port_tç±»å‹çš„ç«¯å£
```

### 3.3 å¸¸ç”¨æœåŠ¡ç«¯å£ç±»å‹å¯¹ç…§


**WebæœåŠ¡ç±»**ï¼š
- `http_port_t`ï¼šWebæœåŠ¡å™¨ï¼ˆ80, 443, 8080ç­‰ï¼‰
- `http_cache_port_t`ï¼šWebç¼“å­˜æœåŠ¡ï¼ˆ3128, 8080ç­‰ï¼‰

**æ•°æ®åº“æœåŠ¡ç±»**ï¼š
- `mysql_port_t`ï¼šMySQLæ•°æ®åº“ï¼ˆ3306ï¼‰
- `postgresql_port_t`ï¼šPostgreSQLæ•°æ®åº“ï¼ˆ5432ï¼‰

**ç³»ç»ŸæœåŠ¡ç±»**ï¼š
- `ssh_port_t`ï¼šSSHæœåŠ¡ï¼ˆ22ï¼‰
- `smtp_port_t`ï¼šé‚®ä»¶æœåŠ¡ï¼ˆ25, 587ï¼‰

---

## 4. âš™ï¸ éæ ‡å‡†ç«¯å£çš„SELinuxé…ç½®


### 4.1 ä»€ä¹ˆæ˜¯éæ ‡å‡†ç«¯å£


**æ ‡å‡†ç«¯å£ vs éæ ‡å‡†ç«¯å£**ï¼š
```
æ ‡å‡†ç«¯å£ï¼š
- Apacheé€šå¸¸ä½¿ç”¨80ç«¯å£ï¼ˆHTTPï¼‰ã€443ç«¯å£ï¼ˆHTTPSï¼‰
- è¿™äº›ç«¯å£å·²ç»æœ‰é¢„è®¾çš„SELinuxæ ‡ç­¾

éæ ‡å‡†ç«¯å£ï¼š
- Apacheæƒ³ä½¿ç”¨8090ç«¯å£
- 8090ç«¯å£é»˜è®¤æ²¡æœ‰http_port_tæ ‡ç­¾
- éœ€è¦æ‰‹åŠ¨é…ç½®SELinux
```

### 4.2 éæ ‡å‡†ç«¯å£é…ç½®æµç¨‹


**å®Œæ•´é…ç½®æµç¨‹**ï¼š

```
ç¬¬1æ­¥ï¼šç¡®å®šæœåŠ¡éœ€è¦çš„ç«¯å£ç±»å‹
       â†“
ç¬¬2æ­¥ï¼šä¸ºç«¯å£æ·»åŠ åˆé€‚çš„æ ‡ç­¾
       â†“  
ç¬¬3æ­¥ï¼šéªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
       â†“
ç¬¬4æ­¥ï¼šå¯åŠ¨æœåŠ¡æµ‹è¯•
```

### 4.3 å®é™…é…ç½®æ¡ˆä¾‹


**æ¡ˆä¾‹1ï¼šApacheä½¿ç”¨8090ç«¯å£**

**é—®é¢˜ç°è±¡**ï¼š
```bash
# Apacheé…ç½®ä½¿ç”¨8090ç«¯å£åæ— æ³•å¯åŠ¨
systemctl start httpd
# é”™è¯¯ï¼šPermission denied: AH00072: make_sock: could not bind to address
```

**è§£å†³æ­¥éª¤**ï¼š

```bash
# æ­¥éª¤1ï¼šæ£€æŸ¥8090ç«¯å£å½“å‰æ ‡ç­¾
semanage port -l | grep ":8090"
# å¯èƒ½æ˜¾ç¤ºï¼šæœªæ‰¾åˆ°æˆ–è€…æ˜¯å…¶ä»–ç±»å‹

# æ­¥éª¤2ï¼šä¸º8090ç«¯å£æ·»åŠ HTTPæ ‡ç­¾
semanage port -a -t http_port_t -p tcp 8090

# æ­¥éª¤3ï¼šéªŒè¯è®¾ç½®
semanage port -l | grep http_port_t | grep 8090

# æ­¥éª¤4ï¼šå¯åŠ¨Apache
systemctl start httpd
```

**æ¡ˆä¾‹2ï¼šSSHä½¿ç”¨2222ç«¯å£**

```bash
# SSHé…ç½®æ–‡ä»¶ä¿®æ”¹ç«¯å£ä¸º2222å
# /etc/ssh/sshd_config: Port 2222

# ä¸º2222ç«¯å£æ·»åŠ SSHæ ‡ç­¾
semanage port -a -t ssh_port_t -p tcp 2222

# é‡å¯SSHæœåŠ¡
systemctl restart sshd
```

### 4.4 å¸¸è§é…ç½®é”™è¯¯


**é”™è¯¯1ï¼šç«¯å£ç±»å‹ä¸åŒ¹é…**
```bash
# é”™è¯¯åšæ³•ï¼šç»™SSHæœåŠ¡çš„ç«¯å£æ·»åŠ HTTPæ ‡ç­¾
semanage port -a -t http_port_t -p tcp 2222

# æ­£ç¡®åšæ³•ï¼šä½¿ç”¨SSHå¯¹åº”çš„æ ‡ç­¾
semanage port -a -t ssh_port_t -p tcp 2222
```

**é”™è¯¯2ï¼šåè®®ç±»å‹é”™è¯¯**
```bash
# å¦‚æœæœåŠ¡ä½¿ç”¨TCPåè®®ï¼Œä¸è¦è®¾ç½®ä¸ºUDP
# é”™è¯¯ï¼š
semanage port -a -t http_port_t -p udp 8090

# æ­£ç¡®ï¼š
semanage port -a -t http_port_t -p tcp 8090
```

---

## 5. ğŸŒ ç½‘ç»œæœåŠ¡SELinuxç­–ç•¥


### 5.1 ç½‘ç»œè®¿é—®æ§åˆ¶æœºåˆ¶


**SELinuxç½‘ç»œè®¿é—®æ§åˆ¶æ¶æ„**ï¼š
```
å®¢æˆ·ç«¯è¿æ¥
     â†“
ç½‘ç»œæ¥å£æ£€æŸ¥
     â†“
ç«¯å£æ ‡ç­¾éªŒè¯
     â†“
æœåŠ¡è¿›ç¨‹æ ‡ç­¾åŒ¹é…
     â†“
SELinuxç­–ç•¥åˆ¤æ–­
     â†“
å…è®¸/æ‹’ç»è¿æ¥
```

### 5.2 ç½‘ç»œç›¸å…³çš„å¸ƒå°”å€¼æ§åˆ¶


**ä»€ä¹ˆæ˜¯SELinuxå¸ƒå°”å€¼**ï¼š
- ç±»ä¼¼äºå¼€å…³ï¼Œæ§åˆ¶æŸäº›åŠŸèƒ½çš„å¼€å¯æˆ–å…³é—­
- ç”¨äºçµæ´»è°ƒæ•´SELinuxç­–ç•¥

**å¸¸ç”¨ç½‘ç»œå¸ƒå°”å€¼**ï¼š

| å¸ƒå°”å€¼åç§° | **ä½œç”¨** | **é»˜è®¤å€¼** | **åº”ç”¨åœºæ™¯** |
|-----------|---------|-----------|-------------|
| `httpd_can_network_connect` | `Apacheæ˜¯å¦å¯ä»¥å‘èµ·ç½‘ç»œè¿æ¥` | `off` | `è¿æ¥æ•°æ®åº“/API` |
| `httpd_can_network_connect_db` | `Apacheæ˜¯å¦å¯ä»¥è¿æ¥æ•°æ®åº“` | `off` | `Webåº”ç”¨è¿æ¥MySQL` |
| `ssh_chroot_rw_homedirs` | `SSHæ˜¯å¦å¯ä»¥å†™å…¥ç”¨æˆ·ç›®å½•` | `off` | `SFTPæ–‡ä»¶ä¸Šä¼ ` |

**æŸ¥çœ‹å’Œä¿®æ”¹å¸ƒå°”å€¼**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œç›¸å…³å¸ƒå°”å€¼
getsebool -a | grep network

# æŸ¥çœ‹Apacheç½‘ç»œè¿æ¥å¸ƒå°”å€¼
getsebool httpd_can_network_connect

# å…è®¸Apacheå‘èµ·ç½‘ç»œè¿æ¥
setsebool -P httpd_can_network_connect on
```

> **ğŸ’¡ æç¤º**ï¼š`-P`å‚æ•°è¡¨ç¤ºæ°¸ä¹…è®¾ç½®ï¼Œé‡å¯åä»ç„¶ç”Ÿæ•ˆ

### 5.3 æœåŠ¡é—´é€šä¿¡çš„SELinuxé…ç½®


**åœºæ™¯ï¼šWebåº”ç”¨è¿æ¥æ•°æ®åº“**

```
WebæœåŠ¡å™¨ï¼ˆhttpd_tï¼‰ â†’ è¿æ¥ â†’ MySQLæ•°æ®åº“ï¼ˆmysqld_tï¼‰
```

**å¯èƒ½é‡åˆ°çš„é—®é¢˜**ï¼š
```bash
# Webåº”ç”¨æŠ¥é”™ï¼šæ— æ³•è¿æ¥æ•°æ®åº“
# SELinuxæ—¥å¿—æ˜¾ç¤ºï¼šhttpd_t denied connect to mysql_port_t
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å…è®¸Apacheè¿æ¥æ•°æ®åº“
setsebool -P httpd_can_network_connect_db on

# æˆ–è€…æ›´å®½æ¾çš„è®¾ç½®
setsebool -P httpd_can_network_connect on
```

---

## 6. ğŸ”’ ç«¯å£è®¿é—®æ§åˆ¶è§„åˆ™


### 6.1 ç«¯å£è®¿é—®æ§åˆ¶çš„åŸç†


**è®¿é—®æ§åˆ¶æµç¨‹**ï¼š
```
è¿›ç¨‹å°è¯•ç»‘å®šç«¯å£
        â†“
SELinuxæ£€æŸ¥ï¼šè¿›ç¨‹æ ‡ç­¾ vs ç«¯å£æ ‡ç­¾
        â†“
    æ˜¯å¦æœ‰åŒ¹é…çš„ç­–ç•¥è§„åˆ™ï¼Ÿ
   â†™                    â†˜
 æœ‰è§„åˆ™                  æ— è§„åˆ™
å…è®¸ç»‘å®š               â†’ æ‹’ç»ç»‘å®š
```

### 6.2 æŸ¥çœ‹ç«¯å£è®¿é—®è§„åˆ™


**æŸ¥çœ‹å“ªäº›è¿›ç¨‹å¯ä»¥ä½¿ç”¨ç‰¹å®šç«¯å£ç±»å‹**ï¼š
```bash
# æŸ¥çœ‹å“ªäº›è¿›ç¨‹å¯ä»¥ç»‘å®šHTTPç«¯å£
sesearch -A -c tcp_socket -p name_bind | grep http_port_t

# æŸ¥çœ‹httpdè¿›ç¨‹å¯ä»¥ç»‘å®šå“ªäº›ç«¯å£
sesearch -A -s httpd_t -c tcp_socket -p name_bind
```

**ç†è§£è§„åˆ™è¾“å‡º**ï¼š
```
è¾“å‡ºç¤ºä¾‹ï¼š
allow httpd_t http_port_t:tcp_socket name_bind;

å«ä¹‰ï¼š
- å…è®¸ï¼ˆallowï¼‰
- httpd_tç±»å‹çš„è¿›ç¨‹
- ç»‘å®šï¼ˆname_bindï¼‰
- http_port_tç±»å‹çš„TCPç«¯å£
```

### 6.3 è‡ªå®šä¹‰è®¿é—®æ§åˆ¶è§„åˆ™


**ä½•æ—¶éœ€è¦è‡ªå®šä¹‰è§„åˆ™**ï¼š
- ä½¿ç”¨ç‰¹æ®Šçš„æœåŠ¡ç»„åˆ
- æ ‡å‡†ç­–ç•¥ä¸æ»¡è¶³ä¸šåŠ¡éœ€æ±‚
- éœ€è¦æ›´ç²¾ç»†çš„è®¿é—®æ§åˆ¶

**åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™çš„åŸºæœ¬æ­¥éª¤**ï¼š
1. åˆ†æéœ€æ±‚å’Œå½“å‰æƒé™
2. ç¼–å†™ç­–ç•¥æ¨¡å—
3. ç¼–è¯‘å’ŒåŠ è½½æ¨¡å—
4. æµ‹è¯•éªŒè¯æ•ˆæœ

> **âš ï¸ æ³¨æ„**ï¼šè‡ªå®šä¹‰SELinuxè§„åˆ™éœ€è¦è¾ƒæ·±çš„ä¸“ä¸šçŸ¥è¯†ï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨æ ‡å‡†æ–¹æ³•ï¼ˆç«¯å£æ ‡ç­¾å’Œå¸ƒå°”å€¼ï¼‰

---

## 7. ğŸ” æœåŠ¡å¯åŠ¨å¤±è´¥çš„SELinuxæ’æŸ¥


### 7.1 å¸¸è§æœåŠ¡å¯åŠ¨å¤±è´¥ç°è±¡


**å…¸å‹é”™è¯¯ä¿¡æ¯**ï¼š
```bash
# Apacheå¯åŠ¨å¤±è´¥
systemctl start httpd
Job for httpd.service failed. See 'systemctl status httpd' for details.

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
systemctl status httpd
â— httpd.service - The Apache HTTP Server
   Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled)
   Active: failed (Result: exit-code) since...
   Main PID: 1234 (code=exited, status=1/FAILURE)

# æŸ¥çœ‹æ—¥å¿—
journalctl -xeu httpd
AH00072: make_sock: could not bind to address [::]:8090
Permission denied
```

### 7.2 SELinuxæ’æŸ¥å·¥å…·


**å·¥å…·1ï¼šå®¡è®¡æ—¥å¿—åˆ†æ**
```bash
# æŸ¥çœ‹SELinuxæ‹’ç»æ—¥å¿—
ausearch -m AVC -ts recent

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„SELinuxæ—¥å¿—
ausearch -m AVC -c httpd
```

**å·¥å…·2ï¼šsealertæ™ºèƒ½åˆ†æ**
```bash
# å®‰è£…SELinuxæ•…éšœæ’é™¤å·¥å…·
yum install setroubleshoot-server

# åˆ†ææœ€è¿‘çš„SELinuxé—®é¢˜
sealert -a /var/log/audit/audit.log

# æŸ¥çœ‹ç‰¹å®šçš„SELinuxæŠ¥è­¦
grep "SELinux is preventing" /var/log/messages
```

### 7.3 å®Œæ•´æ’æŸ¥æµç¨‹


**ç¬¬1æ­¥ï¼šç¡®è®¤SELinuxçŠ¶æ€**
```bash
# æ£€æŸ¥SELinuxæ˜¯å¦å¯ç”¨
getenforce
# åº”è¯¥æ˜¾ç¤ºï¼šEnforcing æˆ– Permissive

# å¦‚æœæ˜¯Disabledï¼ŒSELinuxä¸æ˜¯é—®é¢˜åŸå› 
```

**ç¬¬2æ­¥ï¼šæ£€æŸ¥å®¡è®¡æ—¥å¿—**
```bash
# æŸ¥çœ‹æœ€è¿‘çš„AVCæ‹’ç»æ—¥å¿—
ausearch -m AVC -ts recent | grep httpd
```

**ç¬¬3æ­¥ï¼šåˆ†ææ—¥å¿—ä¿¡æ¯**
```
å…¸å‹æ—¥å¿—ç¤ºä¾‹ï¼š
type=AVC msg=audit(...): avc: denied { name_bind } for pid=1234 
comm="httpd" src=8090 scontext=system_u:system_r:httpd_t:s0 
tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket

å…³é”®ä¿¡æ¯è§£è¯»ï¼š
- denied { name_bind }ï¼šæ‹’ç»ç»‘å®šæ“ä½œ
- comm="httpd"ï¼šApacheè¿›ç¨‹
- src=8090ï¼šå°è¯•ä½¿ç”¨8090ç«¯å£  
- scontext=...httpd_tï¼šè¿›ç¨‹æ ‡ç­¾æ˜¯httpd_t
- tcontext=...unreserved_port_tï¼šç«¯å£æ ‡ç­¾æ˜¯unreserved_port_t
```

**ç¬¬4æ­¥ï¼šç¡®å®šè§£å†³æ–¹æ¡ˆ**
```bash
# æ ¹æ®æ—¥å¿—åˆ†æï¼Œ8090ç«¯å£æ ‡ç­¾ä¸æ­£ç¡®
# åº”è¯¥å°†å…¶è®¾ç½®ä¸ºhttp_port_t

semanage port -a -t http_port_t -p tcp 8090
```

**ç¬¬5æ­¥ï¼šéªŒè¯ä¿®å¤æ•ˆæœ**
```bash
# é‡æ–°å¯åŠ¨æœåŠ¡
systemctl start httpd

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status httpd

# ç¡®è®¤ç«¯å£ç»‘å®šæˆåŠŸ
netstat -tlnp | grep :8090
```

### 7.4 æ’æŸ¥å®æˆ˜æ¡ˆä¾‹


**æ¡ˆä¾‹ï¼šMySQLæ— æ³•ä½¿ç”¨3307ç«¯å£**

**é—®é¢˜ç°è±¡**ï¼š
```bash
# MySQLé…ç½®ä½¿ç”¨3307ç«¯å£åæ— æ³•å¯åŠ¨
systemctl start mysqld
# å¤±è´¥
```

**æ’æŸ¥è¿‡ç¨‹**ï¼š
```bash
# 1. æ£€æŸ¥SELinuxæ—¥å¿—
ausearch -m AVC -c mysqld
# å‘ç°ï¼šdenied { name_bind } ... src=3307

# 2. æ£€æŸ¥3307ç«¯å£å½“å‰æ ‡ç­¾
semanage port -l | grep ":3307"
# æ˜¾ç¤ºï¼šæ²¡æœ‰æ‰¾åˆ°æˆ–è€…æ˜¯å…¶ä»–ç±»å‹

# 3. æŸ¥çœ‹MySQLåº”è¯¥ä½¿ç”¨çš„ç«¯å£ç±»å‹
semanage port -l | grep mysql
# æ˜¾ç¤ºï¼šmysql_port_t: tcp 3306

# 4. ä¸º3307ç«¯å£æ·»åŠ MySQLæ ‡ç­¾
semanage port -a -t mysql_port_t -p tcp 3307

# 5. é‡å¯MySQL
systemctl start mysqld
# æˆåŠŸå¯åŠ¨
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç«¯å£æ ‡ç­¾ï¼šæ¯ä¸ªç«¯å£éƒ½æœ‰å¯¹åº”çš„SELinuxç±»å‹æ ‡ç­¾
ğŸ”¸ æœåŠ¡åŒ¹é…ï¼šæœåŠ¡è¿›ç¨‹æ ‡ç­¾å¿…é¡»ä¸ç«¯å£æ ‡ç­¾åŒ¹é…
ğŸ”¸ semanage portï¼šç®¡ç†ç«¯å£æ ‡ç­¾çš„æ ¸å¿ƒå‘½ä»¤
ğŸ”¸ éæ ‡å‡†ç«¯å£ï¼šéœ€è¦æ‰‹åŠ¨æ·»åŠ åˆé€‚çš„ç«¯å£æ ‡ç­¾
ğŸ”¸ è®¿é—®æ§åˆ¶ï¼šé€šè¿‡æ ‡ç­¾åŒ¹é…å®ç°ç²¾ç»†åŒ–æƒé™æ§åˆ¶
ğŸ”¸ æ•…éšœæ’æŸ¥ï¼šé€šè¿‡å®¡è®¡æ—¥å¿—å®šä½SELinuxç›¸å…³é—®é¢˜
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç«¯å£æ ‡ç­¾çš„ä½œç”¨æœºåˆ¶**
```
åŸç†ï¼šSELinuxç»™æ¯ä¸ªç«¯å£è´´ä¸Š"èº«ä»½æ ‡ç­¾"
ç›®çš„ï¼šç¡®ä¿åªæœ‰åˆé€‚çš„æœåŠ¡æ‰èƒ½ä½¿ç”¨å¯¹åº”ç«¯å£
æ•ˆæœï¼šé˜²æ­¢æ¶æ„ç¨‹åºéšæ„å ç”¨é‡è¦ç«¯å£
```

**ğŸ”¹ å¸¸ç”¨å‘½ä»¤è®°å¿†**
```
æŸ¥çœ‹ç«¯å£æ ‡ç­¾ï¼šsemanage port -l
æ·»åŠ ç«¯å£æ ‡ç­¾ï¼šsemanage port -a -t ç±»å‹ -p åè®® ç«¯å£
åˆ é™¤ç«¯å£æ ‡ç­¾ï¼šsemanage port -d -t ç±»å‹ -p åè®® ç«¯å£
æ’æŸ¥SELinuxé—®é¢˜ï¼šausearch -m AVC -ts recent
```

**ğŸ”¹ æœåŠ¡å¯åŠ¨å¤±è´¥çš„è§£å†³æ€è·¯**
```
1. ç¡®è®¤æ˜¯SELinuxé—®é¢˜ï¼ˆæ£€æŸ¥å®¡è®¡æ—¥å¿—ï¼‰
2. åˆ†ææ—¥å¿—æ‰¾åˆ°å…·ä½“åŸå› ï¼ˆç«¯å£æ ‡ç­¾ä¸åŒ¹é…ï¼‰
3. æ·»åŠ æ­£ç¡®çš„ç«¯å£æ ‡ç­¾
4. é‡å¯æœåŠ¡éªŒè¯æ•ˆæœ
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç³»ç»Ÿç®¡ç†åº”ç”¨**
- **æœåŠ¡éƒ¨ç½²**ï¼šæ­£ç¡®é…ç½®éæ ‡å‡†ç«¯å£çš„SELinuxè®¾ç½®
- **å®‰å…¨åŠ å›º**ï¼šé€šè¿‡ç«¯å£æ ‡ç­¾é™åˆ¶æœåŠ¡ç«¯å£ä½¿ç”¨
- **æ•…éšœæ’æŸ¥**ï¼šå¿«é€Ÿå®šä½æœåŠ¡å¯åŠ¨å¤±è´¥çš„SELinuxåŸå› 
- **æƒé™ä¼˜åŒ–**ï¼šç²¾ç¡®æ§åˆ¶ç½‘ç»œæœåŠ¡çš„ç«¯å£è®¿é—®æƒé™

**ğŸ”§ è¿ç»´å®è·µ**
- **ç«¯å£è§„åˆ’**ï¼šåˆç†åˆ†é…ç«¯å£å¹¶è®¾ç½®å¯¹åº”æ ‡ç­¾
- **æœåŠ¡è¿ç§»**ï¼šç¡®ä¿è¿ç§»åçš„ç«¯å£æœ‰æ­£ç¡®çš„SELinuxé…ç½®
- **å®‰å…¨å®¡è®¡**ï¼šå®šæœŸæ£€æŸ¥ç«¯å£æ ‡ç­¾é…ç½®çš„åˆç†æ€§
- **åº”æ€¥å¤„ç†**ï¼šå¿«é€Ÿè§£å†³SELinuxå¯¼è‡´çš„æœåŠ¡å¯åŠ¨é—®é¢˜

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æœåŠ¡ç«¯å£è¦åŒ¹é…ï¼Œæ ‡ç­¾ç±»å‹ä¸èƒ½å·®
- semanageç®¡ç«¯å£ï¼Œæ·»åŠ åˆ é™¤éƒ½é å®ƒ
- æœåŠ¡å¯åŠ¨è‹¥å¤±è´¥ï¼Œå®¡è®¡æ—¥å¿—æ¥æ’æŸ¥
- éæ ‡ç«¯å£éœ€é…ç½®ï¼Œå®‰å…¨è¿è¡Œæ²¡é—®é¢˜