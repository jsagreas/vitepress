---
title: 12ã€é‡å®šå‘ä¸ç®¡é“ç»„åˆæ“ä½œ
---
## ğŸ“š ç›®å½•

1. [å¤æ‚é‡å®šå‘ç»„åˆè¯­æ³•](#1-å¤æ‚é‡å®šå‘ç»„åˆè¯­æ³•)
2. [ç®¡é“ä¸é‡å®šå‘æ‰§è¡Œä¼˜å…ˆçº§](#2-ç®¡é“ä¸é‡å®šå‘æ‰§è¡Œä¼˜å…ˆçº§)
3. [å¤šå‘½ä»¤ç®¡é“çš„é”™è¯¯ä¼ æ’­](#3-å¤šå‘½ä»¤ç®¡é“çš„é”™è¯¯ä¼ æ’­)
4. [ç®¡é“å¤±è´¥å¤„ç†æœºåˆ¶](#4-ç®¡é“å¤±è´¥å¤„ç†æœºåˆ¶)
5. [é‡å®šå‘åœ¨æ§åˆ¶ç»“æ„ä¸­çš„åº”ç”¨](#5-é‡å®šå‘åœ¨æ§åˆ¶ç»“æ„ä¸­çš„åº”ç”¨)
6. [å­shellé‡å®šå‘ç»§æ‰¿æœºåˆ¶](#6-å­shellé‡å®šå‘ç»§æ‰¿æœºåˆ¶)
7. [é‡å®šå‘ä¸ç®¡é“è°ƒè¯•æŠ€å·§](#7-é‡å®šå‘ä¸ç®¡é“è°ƒè¯•æŠ€å·§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ å¤æ‚é‡å®šå‘ç»„åˆè¯­æ³•


### 1.1 ä»€ä¹ˆæ˜¯é‡å®šå‘ç»„åˆ


**ğŸ”¸ ç®€å•ç†è§£**
é‡å®šå‘ç»„åˆå°±åƒæ˜¯ç»™å‘½ä»¤å®‰è£…å¤šä¸ª"ç®¡å­"ï¼Œå¯ä»¥åŒæ—¶æ§åˆ¶è¾“å…¥ä»å“ªæ¥ã€æ­£å¸¸è¾“å‡ºåˆ°å“ªå»ã€é”™è¯¯è¾“å‡ºåˆ°å“ªå»ã€‚å°±åƒå¨æˆ¿é‡Œçš„æ°´é¾™å¤´ï¼Œä½ å¯ä»¥æ§åˆ¶å†·æ°´çƒ­æ°´åˆ†åˆ«æµå‘ä¸åŒçš„åœ°æ–¹ã€‚

**ğŸ’¡ åŸºæœ¬ç»„åˆåŸåˆ™**
```
å‘½ä»¤çš„ä¸‰ä¸ªé€šé“ï¼š
è¾“å…¥é€šé“  â† stdin  (æ ‡å‡†è¾“å…¥ï¼Œç¼–å·0)
è¾“å‡ºé€šé“  â†’ stdout (æ ‡å‡†è¾“å‡ºï¼Œç¼–å·1) 
é”™è¯¯é€šé“  â†’ stderr (æ ‡å‡†é”™è¯¯ï¼Œç¼–å·2)
```

### 1.2 å¸¸ç”¨ç»„åˆè¯­æ³•è§„åˆ™


**ğŸ”§ åŒæ—¶é‡å®šå‘è¾“å‡ºå’Œé”™è¯¯**

| å†™æ³• | å«ä¹‰ | é€šä¿—è§£é‡Š |
|------|------|----------|
| `cmd > file 2>&1` | è¾“å‡ºå’Œé”™è¯¯éƒ½å†™å…¥file | å…ˆæŠŠè¾“å‡ºå¯¼å‘æ–‡ä»¶ï¼Œå†æŠŠé”™è¯¯å¯¼å‘è¾“å‡ºçš„åœ°æ–¹ |
| `cmd &> file` | åŒä¸Šçš„ç®€åŒ–å†™æ³• | ç›´æ¥æŠŠè¾“å‡ºå’Œé”™è¯¯ä¸€èµ·å¯¼å‘æ–‡ä»¶ |
| `cmd 2>&1 > file` | âŒé”™è¯¯å†™æ³• | é¡ºåºé”™äº†ï¼Œé”™è¯¯è¿˜æ˜¯æ˜¾ç¤ºåœ¨å±å¹•ä¸Š |

**âš ï¸ é¡ºåºå¾ˆé‡è¦**
```bash
# âœ… æ­£ç¡®å†™æ³•ï¼šå…ˆé‡å®šå‘è¾“å‡ºï¼Œå†æŠŠé”™è¯¯å¯¼å‘è¾“å‡º
ls /nonexistent > result.txt 2>&1

# âŒ é”™è¯¯å†™æ³•ï¼šå…ˆå¤„ç†é”™è¯¯ï¼Œè¾“å‡ºé‡å®šå‘åœ¨å
ls /nonexistent 2>&1 > result.txt  # é”™è¯¯è¿˜ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Š
```

**ğŸ¯ åˆ†åˆ«å¤„ç†è¾“å‡ºå’Œé”™è¯¯**
```bash
# è¾“å‡ºå†™å…¥success.txtï¼Œé”™è¯¯å†™å…¥error.txt
cmd > success.txt 2> error.txt

# è¾“å‡ºå†™å…¥æ–‡ä»¶ï¼Œé”™è¯¯ä¸¢å¼ƒ
cmd > output.txt 2>/dev/null

# é”™è¯¯å†™å…¥æ–‡ä»¶ï¼Œè¾“å‡ºä¸¢å¼ƒ
cmd 2> error.txt >/dev/null
```

### 1.3 é«˜çº§ç»„åˆæŠ€å·§


**ğŸ“Š Here Document ä¸é‡å®šå‘ç»„åˆ**
```bash
# ä»å¤šè¡Œæ–‡æœ¬è¾“å…¥ï¼Œç»“æœå†™å…¥æ–‡ä»¶
cat > config.txt <<EOF
server=localhost
port=8080
debug=true
EOF
```

**ğŸ”€ è¿½åŠ ä¸è¦†ç›–æ··åˆ**
```bash
# è¾“å‡ºè¦†ç›–ï¼Œé”™è¯¯è¿½åŠ 
cmd > output.txt 2>> error.log

# è¾“å‡ºè¿½åŠ ï¼Œé”™è¯¯è¦†ç›–  
cmd >> output.txt 2> error.txt
```

---

## 2. âš¡ ç®¡é“ä¸é‡å®šå‘æ‰§è¡Œä¼˜å…ˆçº§


### 2.1 æ‰§è¡Œé¡ºåºåŸç†


**ğŸ§  Shellå¤„ç†é¡ºåº**
Shellå¤„ç†å‘½ä»¤æ—¶å°±åƒæµæ°´çº¿å·¥å‚ï¼ŒæŒ‰å›ºå®šé¡ºåºç»„è£…ï¼š

```
å¤„ç†æµç¨‹ï¼š
1ï¸âƒ£ è§£æé‡å®šå‘ (è®¾ç½®è¾“å…¥è¾“å‡ºé€šé“)
2ï¸âƒ£ åˆ›å»ºç®¡é“ (è¿æ¥å‘½ä»¤ä¹‹é—´çš„é€šé“)  
3ï¸âƒ£ æ‰§è¡Œå‘½ä»¤ (åœ¨è®¾å®šçš„é€šé“ç¯å¢ƒä¸­è¿è¡Œ)
```

**ğŸ’¡ ä¼˜å…ˆçº§è§„åˆ™**
- **é‡å®šå‘ä¼˜å…ˆäºç®¡é“**ï¼šå…ˆç¡®å®šæ¯ä¸ªå‘½ä»¤çš„è¾“å…¥è¾“å‡ºï¼Œå†å»ºç«‹ç®¡é“è¿æ¥
- **ä»å·¦åˆ°å³å¤„ç†**ï¼šæŒ‰å‘½ä»¤å‡ºç°çš„é¡ºåºå¤„ç†
- **å°±è¿‘åŸåˆ™**ï¼šé‡å®šå‘ç¬¦å·å½±å“æœ€è¿‘çš„å‘½ä»¤

### 2.2 å¸¸è§ä¼˜å…ˆçº§åœºæ™¯


**ğŸ¯ åœºæ™¯ä¸€ï¼šç®¡é“åçš„é‡å®šå‘**
```bash
# ç®¡é“æœ€åä¸€ä¸ªå‘½ä»¤çš„é‡å®šå‘
cmd1 | cmd2 > output.txt
```

```
æ‰§è¡Œè§£æï¼š
cmd1 â”€â”€ç®¡é“â”€â”€> cmd2 â”€â”€é‡å®šå‘â”€â”€> output.txt
              â†‘
           åªæœ‰cmd2çš„è¾“å‡ºè¢«é‡å®šå‘
```

**ğŸ¯ åœºæ™¯äºŒï¼šç®¡é“ä¸­é—´çš„é‡å®šå‘**
```bash
# ä¸­é—´å‘½ä»¤çš„é‡å®šå‘ä¸å½±å“ç®¡é“
cmd1 | cmd2 > temp.txt | cmd3
```

```
æ‰§è¡Œè§£æï¼š
cmd1 â”€â”€ç®¡é“â”€â”€> cmd2 â”¬â”€â”€é‡å®šå‘â”€â”€> temp.txt
                   â””â”€â”€ç®¡é“â”€â”€â”€â”€> cmd3 (æ¥æ”¶ç©ºè¾“å…¥)
```

**âš ï¸ æ–°æ‰‹æ˜“é”™ç‚¹**
```bash
# âŒ æƒ³è¦ï¼šæŠŠæ•´ä¸ªç®¡é“çš„è¾“å‡ºå­˜åˆ°æ–‡ä»¶
echo "test" | grep "t" > result.txt | wc -l
# å®é™…ï¼šwc -l æ²¡æœ‰è¾“å…¥ï¼Œå› ä¸ºgrepçš„è¾“å‡ºè¢«é‡å®šå‘äº†

# âœ… æ­£ç¡®å†™æ³•ï¼š
echo "test" | grep "t" | tee result.txt | wc -l
```

### 2.3 å¤æ‚ç»„åˆçš„æ‰§è¡Œé€»è¾‘


**ğŸ”„ å¤šé‡é‡å®šå‘ä¸ç®¡é“**
```bash
cmd1 2>&1 | cmd2 > out.txt 2> err.txt
```

```
æ‰§è¡Œåˆ†æï¼š
1. cmd1çš„é”™è¯¯é‡å®šå‘åˆ°è¾“å‡º (2>&1)
2. cmd1çš„è¾“å‡º(å«é”™è¯¯)é€šè¿‡ç®¡é“ç»™cmd2
3. cmd2çš„è¾“å‡ºé‡å®šå‘åˆ°out.txt
4. cmd2çš„é”™è¯¯é‡å®šå‘åˆ°err.txt
```

---

## 3. ğŸŒŠ å¤šå‘½ä»¤ç®¡é“çš„é”™è¯¯ä¼ æ’­


### 3.1 ä»€ä¹ˆæ˜¯é”™è¯¯ä¼ æ’­


**ğŸ”¸ é€šä¿—è§£é‡Š**
å°±åƒå·¥å‚æµæ°´çº¿ï¼Œå¦‚æœæŸä¸ªç¯èŠ‚å‡ºé”™äº†ï¼Œåç»­ç¯èŠ‚ä¼šå—åˆ°ä»€ä¹ˆå½±å“ï¼Ÿåœ¨Linuxç®¡é“ä¸­ï¼Œæ¯ä¸ªå‘½ä»¤éƒ½æœ‰è‡ªå·±çš„é€€å‡ºçŠ¶æ€ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼Œè¿™äº›çŠ¶æ€å¦‚ä½•å½±å“æ•´ä¸ªç®¡é“é“¾æ¡ï¼Ÿ

**ğŸ“Š ç®¡é“çŠ¶æ€ç¤ºæ„**
```
cmd1 â”€â”€çŠ¶æ€1â”€â”€> cmd2 â”€â”€çŠ¶æ€2â”€â”€> cmd3 â”€â”€çŠ¶æ€3â”€â”€> æœ€ç»ˆçŠ¶æ€
```

### 3.2 é»˜è®¤çš„é”™è¯¯ä¼ æ’­æœºåˆ¶


**âš¡ Linuxç®¡é“çš„é»˜è®¤è¡Œä¸º**
- **ç»§ç»­æ‰§è¡Œ**ï¼šå‰é¢å‘½ä»¤å¤±è´¥ï¼Œåé¢å‘½ä»¤ä»ç„¶å°è¯•æ‰§è¡Œ
- **è¾“å…¥ä¸ºç©º**ï¼šå‰é¢å‘½ä»¤å¤±è´¥æ—¶ï¼Œåé¢å‘½ä»¤å¯èƒ½æ”¶åˆ°ç©ºè¾“å…¥
- **çŠ¶æ€è¦†ç›–**ï¼šæ•´ä¸ªç®¡é“çš„é€€å‡ºçŠ¶æ€æ˜¯æœ€åä¸€ä¸ªå‘½ä»¤çš„çŠ¶æ€

**ğŸ’¡ å®é™…ç¤ºä¾‹**
```bash
# æ¼”ç¤ºé”™è¯¯ä¼ æ’­
ls /nonexistent | wc -l | cat
```

```
æ‰§è¡Œè¿‡ç¨‹ï¼š
1. ls /nonexistent å¤±è´¥(é”™è¯¯è¾“å‡ºåˆ°stderr)
2. wc -l æ”¶åˆ°ç©ºè¾“å…¥ï¼Œè¾“å‡º 0
3. cat æ”¶åˆ° 0ï¼Œæ­£å¸¸è¾“å‡º
4. æ•´ä¸ªç®¡é“é€€å‡ºçŠ¶æ€ä¸º0(æˆåŠŸ) - å› ä¸ºcatæˆåŠŸäº†
```

**ğŸ” æ£€æŸ¥ç®¡é“çŠ¶æ€**
```bash
# æŸ¥çœ‹ç®¡é“ä¸­å„å‘½ä»¤çš„é€€å‡ºçŠ¶æ€
ls /nonexistent | wc -l | cat
echo "ç®¡é“çŠ¶æ€: ${PIPESTATUS[@]}"  # è¾“å‡º: 2 0 0
```

### 3.3 é”™è¯¯ä¼ æ’­çš„å½±å“


**ğŸ¯ å¸¸è§é—®é¢˜åœºæ™¯**

| åœºæ™¯ | é—®é¢˜ | å½±å“ |
|------|------|------|
| æ–‡ä»¶ä¸å­˜åœ¨ | `cat missing.txt \| grep pattern` | grepæ”¶åˆ°ç©ºè¾“å…¥ï¼Œæ­£å¸¸é€€å‡º |
| ç½‘ç»œå‘½ä»¤å¤±è´¥ | `curl url \| jq .data` | jqå¯èƒ½è§£æç©ºæ•°æ®æŠ¥é”™ |
| è¿‡æ»¤å‘½ä»¤æ— åŒ¹é… | `ps aux \| grep nonexist` | ç®¡é“æˆåŠŸä½†æ— å®é™…ç»“æœ |

**âš ï¸ è°ƒè¯•æŠ€å·§**
```bash
# æ˜¾ç¤ºæ¯ä¸€æ­¥çš„çŠ¶æ€
cmd1 | { echo "cmd1çŠ¶æ€: $?"; cmd2; } | cmd3

# åœ¨ç®¡é“ä¸­æ’å…¥è°ƒè¯•ç‚¹
cmd1 | tee debug1.txt | cmd2 | tee debug2.txt | cmd3
```

---

## 4. ğŸ›¡ï¸ ç®¡é“å¤±è´¥å¤„ç†æœºåˆ¶


### 4.1 set -o pipefailè¯¦è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯pipefail**
`pipefail`æ˜¯bashçš„ä¸€ä¸ªé€‰é¡¹ï¼Œæ”¹å˜ç®¡é“çš„å¤±è´¥åˆ¤æ–­è§„åˆ™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰æœ€åä¸€ä¸ªå‘½ä»¤å¤±è´¥ï¼Œæ•´ä¸ªç®¡é“æ‰ç®—å¤±è´¥ã€‚å¼€å¯pipefailåï¼Œä»»ä½•ä¸€ä¸ªå‘½ä»¤å¤±è´¥ï¼Œæ•´ä¸ªç®¡é“å°±ç®—å¤±è´¥ã€‚

**ğŸ’¡ å¼€å¯æ–¹å¼**
```bash
# å¼€å¯pipefail
set -o pipefail

# å…³é—­pipefail  
set +o pipefail

# æŸ¥çœ‹å½“å‰çŠ¶æ€
set -o | grep pipefail
```

### 4.2 pipefailçš„å·¥ä½œåŸç†


**ğŸ“Š å¯¹æ¯”æ•ˆæœ**

| æƒ…å†µ | é»˜è®¤è¡Œä¸º | pipefailå¼€å¯å |
|------|----------|---------------|
| ç¬¬ä¸€ä¸ªå‘½ä»¤å¤±è´¥ | ç®¡é“å¯èƒ½æˆåŠŸ | ç®¡é“å¤±è´¥ |
| ä¸­é—´å‘½ä»¤å¤±è´¥ | ç®¡é“å¯èƒ½æˆåŠŸ | ç®¡é“å¤±è´¥ |
| æœ€åå‘½ä»¤å¤±è´¥ | ç®¡é“å¤±è´¥ | ç®¡é“å¤±è´¥ |

**ğŸ” å®è·µå¯¹æ¯”**
```bash
# é»˜è®¤è¡Œä¸º
ls /nonexistent | wc -l
echo "é€€å‡ºçŠ¶æ€: $?"  # è¾“å‡º: 0 (æˆåŠŸ)

# å¼€å¯pipefailå
set -o pipefail
ls /nonexistent | wc -l  
echo "é€€å‡ºçŠ¶æ€: $?"  # è¾“å‡º: 2 (å¤±è´¥)
```

### 4.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ æ•°æ®å¤„ç†ç®¡é“**
```bash
#!/bin/bash
set -o pipefail  # ç¡®ä¿ä»»ä½•æ­¥éª¤å¤±è´¥éƒ½ä¼šè¢«æ£€æµ‹åˆ°

# æ•°æ®å¤„ç†ç®¡é“
curl -s "https://api.example.com/data" | \
  jq '.results[]' | \
  grep "active" | \
  wc -l > result.txt

if [ $? -ne 0 ]; then
    echo "æ•°æ®å¤„ç†å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ•°æ®æ ¼å¼"
    exit 1
fi
```

**ğŸ”§ é”™è¯¯å¤„ç†æœ€ä½³å®è·µ**
```bash
#!/bin/bash
set -e          # å‘½ä»¤å¤±è´¥æ—¶é€€å‡º
set -o pipefail # ç®¡é“ä¸­ä»»ä½•å‘½ä»¤å¤±è´¥éƒ½ç®—å¤±è´¥
set -u          # ä½¿ç”¨æœªå®šä¹‰å˜é‡æ—¶æŠ¥é”™

# ç°åœ¨è¿™ä¸ªè„šæœ¬ä¼šåœ¨ç¬¬ä¸€ä¸ªé”™è¯¯å¤„åœæ­¢
process_data() {
    input_file="$1"
    
    cat "$input_file" | \
      sort | \
      uniq -c | \
      sort -nr > processed_data.txt
    
    echo "å¤„ç†å®Œæˆ"
}
```

### 4.4 ç®¡é“å¤±è´¥çš„å¤„ç†ç­–ç•¥


**ğŸ› ï¸ ç­–ç•¥ä¸€ï¼šæ¡ä»¶æ£€æŸ¥**
```bash
# æ£€æŸ¥ç®¡é“æ˜¯å¦æˆåŠŸ
if command1 | command2 | command3; then
    echo "å¤„ç†æˆåŠŸ"
else
    echo "ç®¡é“å¤„ç†å¤±è´¥ï¼ŒçŠ¶æ€: ${PIPESTATUS[@]}"
fi
```

**ğŸ› ï¸ ç­–ç•¥äºŒï¼šåˆ†æ­¥å¤„ç†**
```bash
# å°†å¤æ‚ç®¡é“æ‹†åˆ†ä¸ºæ­¥éª¤
step1_output=$(command1) || { echo "æ­¥éª¤1å¤±è´¥"; exit 1; }
step2_output=$(echo "$step1_output" | command2) || { echo "æ­¥éª¤2å¤±è´¥"; exit 1; }
echo "$step2_output" | command3 || { echo "æ­¥éª¤3å¤±è´¥"; exit 1; }
```

---

## 5. ğŸ”€ é‡å®šå‘åœ¨æ§åˆ¶ç»“æ„ä¸­çš„åº”ç”¨


### 5.1 å¾ªç¯ä¸­çš„é‡å®šå‘


**ğŸ”„ whileå¾ªç¯ä¸é‡å®šå‘**
```bash
# ä»æ–‡ä»¶é€è¡Œè¯»å–
while read line; do
    echo "å¤„ç†: $line"
done < input.txt

# è¯»å–å¹¶è¾“å‡ºåˆ°æ–‡ä»¶
while read line; do
    echo "å¤„ç†: $line"
done < input.txt > output.txt
```

**ğŸ’¡ forå¾ªç¯çš„è¾“å‡ºé‡å®šå‘**
```bash
# æ•´ä¸ªå¾ªç¯çš„è¾“å‡ºé‡å®šå‘
for file in *.txt; do
    echo "æ–‡ä»¶: $file"
    wc -l "$file"
done > summary.txt

# å¾ªç¯å†…éƒ¨é‡å®šå‘
for i in {1..3}; do
    echo "æ—¥å¿— $i" >> log.txt
done
```

### 5.2 æ¡ä»¶è¯­å¥ä¸­çš„é‡å®šå‘


**ğŸ¯ ifè¯­å¥ä¸é‡å®šå‘**
```bash
# æ¡ä»¶æ£€æŸ¥çš„è¾“å‡ºé‡å®šå‘
if command_check > result.txt 2>&1; then
    echo "æ£€æŸ¥é€šè¿‡"
else
    echo "æ£€æŸ¥å¤±è´¥ï¼Œè¯¦æƒ…è§result.txt"
fi

# ä¸åŒåˆ†æ”¯çš„ä¸åŒé‡å®šå‘
if [ "$debug" = "true" ]; then
    process_data > debug.log 2>&1
else
    process_data > /dev/null 2>&1
fi
```

### 5.3 å‡½æ•°ä¸­çš„é‡å®šå‘ç»§æ‰¿


**ğŸ”§ å‡½æ•°é‡å®šå‘æŠ€å·§**
```bash
# å‡½æ•°çº§åˆ«é‡å®šå‘
log_function() {
    echo "å¼€å§‹å¤„ç†"
    some_command
    echo "å¤„ç†å®Œæˆ"
} > function.log 2>&1

# è°ƒç”¨æ—¶é‡å®šå‘
process_with_log() {
    echo "æ­¥éª¤1"
    echo "æ­¥éª¤2"  
}

# æ•´ä¸ªå‡½æ•°è¾“å‡ºé‡å®šå‘
process_with_log > process.log
```

---

## 6. ğŸ‘¶ å­shellé‡å®šå‘ç»§æ‰¿æœºåˆ¶


### 6.1 ä»€ä¹ˆæ˜¯å­shellç»§æ‰¿


**ğŸ”¸ é€šä¿—ç†è§£**
å­shellå°±åƒæ˜¯çˆ¶shellçš„"åˆ†èº«"ï¼Œå®ƒä¼šç»§æ‰¿çˆ¶shellçš„ä¸€äº›è®¾ç½®ã€‚å°±åƒå­©å­ä¼šç»§æ‰¿çˆ¶æ¯çš„ä¸€äº›ç‰¹å¾ï¼Œä½†ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„ç‰¹ç‚¹ã€‚

**ğŸŒ³ ç»§æ‰¿å…³ç³»å›¾**
```
çˆ¶Shell
â”œâ”€â”€ ç¯å¢ƒå˜é‡ âœ… (ç»§æ‰¿)
â”œâ”€â”€ æ–‡ä»¶æè¿°ç¬¦ âœ… (ç»§æ‰¿)  
â”œâ”€â”€ å·¥ä½œç›®å½• âœ… (ç»§æ‰¿)
â””â”€â”€ é‡å®šå‘è®¾ç½® âœ… (ç»§æ‰¿)
    â””â”€â”€ å­Shell
        â”œâ”€â”€ å¯ä»¥ä¿®æ”¹ç»§æ‰¿çš„è®¾ç½®
        â””â”€â”€ ä¿®æ”¹ä¸å½±å“çˆ¶Shell
```

### 6.2 é‡å®šå‘ç»§æ‰¿å®ä¾‹


**ğŸ“Š åŸºæœ¬ç»§æ‰¿ç¤ºä¾‹**
```bash
# çˆ¶shellè®¾ç½®é‡å®šå‘
exec 3> debug.log

# å­shellä¸­å¯ä»¥ä½¿ç”¨
(
    echo "å­shellæ¶ˆæ¯" >&3
    echo "è¿™ä¼šå†™å…¥debug.log"
)

# éªŒè¯æ–‡ä»¶å†…å®¹
cat debug.log
```

**ğŸ”„ ç®¡é“ä¸­çš„ç»§æ‰¿**
```bash
# çˆ¶shellè®¾ç½®
exec 4< input.txt

# ç®¡é“ä¸­çš„å‘½ä»¤ç»§æ‰¿æ–‡ä»¶æè¿°ç¬¦
cat <&4 | while read line; do
    echo "å¤„ç†: $line"
done
```

### 6.3 å­shellé‡å®šå‘çš„å®é™…åº”ç”¨


**ğŸ¯ ä¸´æ—¶é‡å®šå‘ç¯å¢ƒ**
```bash
# åœ¨å­shellä¸­ä¸´æ—¶æ”¹å˜è¾“å‡º
(
    exec > temp_output.txt
    echo "è¿™äº›å†…å®¹å†™å…¥æ–‡ä»¶"
    ls -la
    date
)  # å­shellç»“æŸï¼Œé‡å®šå‘ä¹Ÿç»“æŸ

echo "è¿™è¡Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Š"  # æ­£å¸¸è¾“å‡ºåˆ°ç»ˆç«¯
```

**ğŸ”§ é”™è¯¯éš”ç¦»å¤„ç†**
```bash
# å­shellä¸­éš”ç¦»é”™è¯¯å¤„ç†
process_risky_operation() {
    (
        set -e  # åœ¨å­shellä¸­è®¾ç½®é”™è¯¯é€€å‡º
        risky_command1
        risky_command2
        risky_command3
    ) 2> error_isolated.log
    
    # çˆ¶shellä¸å—å­shellçš„set -eå½±å“
    echo "é£é™©æ“ä½œå®Œæˆï¼Œæ£€æŸ¥error_isolated.log"
}
```

---

## 7. ğŸ” é‡å®šå‘ä¸ç®¡é“è°ƒè¯•æŠ€å·§


### 7.1 è°ƒè¯•å·¥å…·å’Œæ–¹æ³•


**ğŸ› ï¸ åŸºç¡€è°ƒè¯•é€‰é¡¹**

| è°ƒè¯•é€‰é¡¹ | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|----------|------|----------|
| `set -x` | æ˜¾ç¤ºæ‰§è¡Œçš„å‘½ä»¤ | è·Ÿè¸ªè„šæœ¬æ‰§è¡Œ |
| `set -v` | æ˜¾ç¤ºè¯»å–çš„å‘½ä»¤è¡Œ | æŸ¥çœ‹å‘½ä»¤è§£æ |
| `bash -x script.sh` | è°ƒè¯•æ¨¡å¼è¿è¡Œè„šæœ¬ | è„šæœ¬è°ƒè¯• |

**ğŸ’¡ å®ç”¨è°ƒè¯•æŠ€å·§**
```bash
#!/bin/bash
# å¼€å¯è°ƒè¯•
set -x

echo "å¼€å§‹å¤„ç†æ•°æ®"
cat data.txt | grep "pattern" | sort > result.txt
echo "å¤„ç†å®Œæˆ"

# å…³é—­è°ƒè¯•
set +x
```

### 7.2 ç®¡é“è°ƒè¯•ç­–ç•¥


**ğŸ” æ’å…¥è°ƒè¯•ç‚¹**
```bash
# ä½¿ç”¨teeæŸ¥çœ‹ä¸­é—´ç»“æœ
cmd1 | tee debug1.txt | cmd2 | tee debug2.txt | cmd3

# ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶åˆ†æ­¥è°ƒè¯•
cmd1 > step1.tmp
cmd2 < step1.tmp > step2.tmp  
cmd3 < step2.tmp > final.txt
```

**ğŸ“Š çŠ¶æ€æ£€æŸ¥æŠ€å·§**
```bash
# æ£€æŸ¥æ¯ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€
cmd1 | cmd2 | cmd3
pipeline_status=("${PIPESTATUS[@]}")

echo "ç®¡é“å„å‘½ä»¤çŠ¶æ€:"
for i in "${!pipeline_status[@]}"; do
    echo "å‘½ä»¤$((i+1)): ${pipeline_status[i]}"
done
```

### 7.3 å¸¸è§é—®é¢˜æ’æŸ¥


**ğŸš¨ é—®é¢˜æ’æŸ¥æ¸…å•**

âœ… **æ£€æŸ¥é¡¹ç›®åˆ—è¡¨**
- [ ] é‡å®šå‘ç¬¦å·é¡ºåºæ˜¯å¦æ­£ç¡®
- [ ] æ–‡ä»¶æƒé™æ˜¯å¦è¶³å¤Ÿ  
- [ ] ç®¡é“ä¸­å‘½ä»¤æ˜¯å¦éƒ½å­˜åœ¨
- [ ] è¾“å…¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- [ ] è¾“å‡ºç›®å½•æ˜¯å¦å¯å†™

**ğŸ”§ æ’æŸ¥å·¥å…·**
```bash
# æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€
lsof -p $$

# æŸ¥çœ‹è¿›ç¨‹çš„é‡å®šå‘æƒ…å†µ  
ls -la /proc/$$/fd/

# æµ‹è¯•é‡å®šå‘æ˜¯å¦ç”Ÿæ•ˆ
echo "test" > /tmp/redirect_test && echo "é‡å®šå‘æˆåŠŸ"
```

### 7.4 æ€§èƒ½è°ƒè¯•


**âš¡ æ€§èƒ½åˆ†ææŠ€å·§**
```bash
# ä½¿ç”¨timeå‘½ä»¤åˆ†æç®¡é“æ€§èƒ½
time (cmd1 | cmd2 | cmd3)

# åˆ†åˆ«æµ‹è¯•æ¯ä¸ªå‘½ä»¤çš„æ€§èƒ½
time cmd1 < input > temp1
time cmd2 < temp1 > temp2  
time cmd3 < temp2 > output
```

**ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
- **å‡å°‘ç®¡é“é•¿åº¦**ï¼šè¿‡é•¿çš„ç®¡é“å½±å“æ€§èƒ½
- **ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶**ï¼šå¤æ‚å¤„ç†æ—¶è€ƒè™‘åˆ†æ­¥è¿›è¡Œ
- **é¿å…ä¸å¿…è¦çš„é‡å®šå‘**ï¼šæ¯ä¸ªé‡å®šå‘éƒ½æœ‰å¼€é”€
- **åˆç†ä½¿ç”¨ç¼“å†²**ï¼šå¤§æ•°æ®å¤„ç†æ—¶æ³¨æ„ç¼“å†²åŒºè®¾ç½®

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é‡å®šå‘ç»„åˆï¼šåŒæ—¶æ§åˆ¶å¤šä¸ªè¾“å…¥è¾“å‡ºé€šé“
ğŸ”¸ æ‰§è¡Œä¼˜å…ˆçº§ï¼šé‡å®šå‘å…ˆäºç®¡é“ï¼Œä»å·¦åˆ°å³å¤„ç†  
ğŸ”¸ é”™è¯¯ä¼ æ’­ï¼šç®¡é“ä¸­é”™è¯¯å¦‚ä½•å½±å“åç»­å‘½ä»¤
ğŸ”¸ pipefailæœºåˆ¶ï¼šæ”¹å˜ç®¡é“å¤±è´¥åˆ¤æ–­è§„åˆ™
ğŸ”¸ ç»§æ‰¿æœºåˆ¶ï¼šå­shellå¦‚ä½•ç»§æ‰¿çˆ¶shellçš„é‡å®šå‘è®¾ç½®
```

### 8.2 å…³é”®æ“ä½œæŠ€å·§


**ğŸ”¹ é‡å®šå‘ç»„åˆåŸåˆ™**
```
è®°ä½é¡ºåºï¼šcommand > output.txt 2>&1
- å…ˆå¤„ç†è¾“å‡ºé‡å®šå‘
- å†å¤„ç†é”™è¯¯é‡å®šå‘  
- 2>&1 è¡¨ç¤ºé”™è¯¯è·Ÿéšè¾“å‡º
```

**ğŸ”¹ ç®¡é“è°ƒè¯•æ–¹æ³•**
```
ä¸‰æ­¥è°ƒè¯•æ³•ï¼š
1. ä½¿ç”¨teeæŸ¥çœ‹ä¸­é—´ç»“æœ
2. æ£€æŸ¥PIPESTATUSæ•°ç»„
3. åˆ†æ­¥æ‰§è¡ŒéªŒè¯é€»è¾‘
```

**ğŸ”¹ é”™è¯¯å¤„ç†ç­–ç•¥**
```
ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š
set -e          # å‘½ä»¤å¤±è´¥å³é€€å‡º
set -o pipefail # ç®¡é“ä»»ä¸€å¤±è´¥å³å¤±è´¥
set -u          # æœªå®šä¹‰å˜é‡æŠ¥é”™
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ“Š åº”ç”¨åœºæ™¯å¯¹ç…§**

| åœºæ™¯ | æŠ€æœ¯è¦ç‚¹ | å®é™…ä»·å€¼ |
|------|----------|----------|
| **æ•°æ®å¤„ç†è„šæœ¬** | pipefail + é”™è¯¯æ£€æŸ¥ | ç¡®ä¿æ•°æ®å®Œæ•´æ€§ |
| **æ—¥å¿—åˆ†æ** | å¤æ‚é‡å®šå‘ç»„åˆ | åˆ†ç¦»æ­£å¸¸å’Œé”™è¯¯æ—¥å¿— |
| **è‡ªåŠ¨åŒ–éƒ¨ç½²** | å­shellç»§æ‰¿ + è°ƒè¯• | éš”ç¦»ç¯å¢ƒï¼Œä¾¿äºæ’é”™ |
| **ç›‘æ§è„šæœ¬** | ç®¡é“çŠ¶æ€æ£€æŸ¥ | åŠæ—¶å‘ç°å¤„ç†å¼‚å¸¸ |

### 8.4 å­¦ä¹ è¿›åº¦æ£€æŸ¥


âœ… **è‡ªæˆ‘æ£€æµ‹æ¸…å•**
- [ ] èƒ½å†™å‡ºæ­£ç¡®çš„é‡å®šå‘ç»„åˆè¯­æ³•
- [ ] ç†è§£ç®¡é“ä¸é‡å®šå‘çš„æ‰§è¡Œé¡ºåº  
- [ ] çŸ¥é“å¦‚ä½•æ£€æŸ¥ç®¡é“ä¸­å„å‘½ä»¤çŠ¶æ€
- [ ] ä¼šä½¿ç”¨pipefailå¤„ç†ç®¡é“å¤±è´¥
- [ ] èƒ½åœ¨è„šæœ¬ä¸­æ­£ç¡®åº”ç”¨è¿™äº›æŠ€å·§

**ğŸ¯ è¿›é˜¶å­¦ä¹ å»ºè®®**
- **ç»ƒä¹ å¤æ‚åœºæ™¯**ï¼šå°è¯•å¤šç§é‡å®šå‘ç»„åˆ
- **é˜…è¯»ä¼˜ç§€è„šæœ¬**ï¼šå­¦ä¹ å®é™…é¡¹ç›®ä¸­çš„ç”¨æ³•
- **æ€§èƒ½è°ƒä¼˜**ï¼šäº†è§£é‡å®šå‘å’Œç®¡é“çš„æ€§èƒ½å½±å“
- **é”™è¯¯å¤„ç†**ï¼šå»ºç«‹å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

### 8.5 å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥


**ğŸ“š é‡å®šå‘ç¬¦å·**
```bash
>    # è¾“å‡ºé‡å®šå‘(è¦†ç›–)
>>   # è¾“å‡ºé‡å®šå‘(è¿½åŠ )  
2>   # é”™è¯¯é‡å®šå‘
2>&1 # é”™è¯¯é‡å®šå‘åˆ°è¾“å‡º
&>   # è¾“å‡ºå’Œé”™è¯¯éƒ½é‡å®šå‘
```

**ğŸ”§ è°ƒè¯•å‘½ä»¤**
```bash
set -x                    # å¼€å¯è°ƒè¯•æ¨¡å¼
echo ${PIPESTATUS[@]}     # æŸ¥çœ‹ç®¡é“çŠ¶æ€
lsof -p $$               # æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦
tee file.txt             # æŸ¥çœ‹ç®¡é“ä¸­é—´ç»“æœ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é‡å®šå‘ç»„åˆæœ‰é¡ºåºï¼Œè¾“å‡ºåœ¨å‰é”™è¯¯å
- ç®¡é“ä¼ æ’­çœ‹æœ€åï¼Œpipefailæ”¹è§„çŸ©  
- å­shellç»§æ‰¿çˆ¶è®¾ç½®ï¼Œè°ƒè¯•åˆ†æ­¥æ‰¾é—®é¢˜
- ç”Ÿäº§ç¯å¢ƒè¦ä¸¥æ ¼ï¼Œé”™è¯¯å¤„ç†ä¸èƒ½çœ