---
title: 3ã€libvirtç®¡ç†æ¡†æ¶
---
## ğŸ“š ç›®å½•

1. [libvirtæ¶æ„æ¦‚è¿°](#1-libvirtæ¶æ„æ¦‚è¿°)
2. [libvirtdå®ˆæŠ¤è¿›ç¨‹é…ç½®](#2-libvirtdå®ˆæŠ¤è¿›ç¨‹é…ç½®)
3. [virshå‘½ä»¤è¡Œç®¡ç†å·¥å…·](#3-virshå‘½ä»¤è¡Œç®¡ç†å·¥å…·)
4. [XMLåŸŸé…ç½®æ–‡ä»¶è¯¦è§£](#4-XMLåŸŸé…ç½®æ–‡ä»¶è¯¦è§£)
5. [è¿æ¥URIä¸è¿œç¨‹ç®¡ç†](#5-è¿æ¥URIä¸è¿œç¨‹ç®¡ç†)
6. [ç½‘ç»œä¸å­˜å‚¨æ± ç®¡ç†](#6-ç½‘ç»œä¸å­˜å‚¨æ± ç®¡ç†)
7. [æƒé™ä¸å®‰å…¨ç­–ç•¥](#7-æƒé™ä¸å®‰å…¨ç­–ç•¥)
8. [APIæ¥å£ä¸ç¼–ç¨‹é›†æˆ](#8-APIæ¥å£ä¸ç¼–ç¨‹é›†æˆ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ libvirtæ¶æ„æ¦‚è¿°


### 1.1 libvirtåŸºæœ¬å®šä¹‰


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
libvirtï¼šå¼€æºçš„è™šæ‹ŸåŒ–ç®¡ç†åº“å’Œå·¥å…·é›†
ç›®æ ‡ï¼šæä¾›ç»Ÿä¸€çš„APIæ¥ç®¡ç†ä¸åŒçš„è™šæ‹ŸåŒ–æŠ€æœ¯
æ”¯æŒï¼šKVMã€Xenã€VMwareã€VirtualBoxç­‰å¤šç§Hypervisor
è®¾è®¡ç†å¿µï¼šæŠ½è±¡åŒ–è™šæ‹ŸåŒ–ç®¡ç†ï¼Œå±è”½åº•å±‚å·®å¼‚
```

**ğŸ’¡ è®¾è®¡ä¼˜åŠ¿**
- **ç»Ÿä¸€æ¥å£**ï¼šä¸€å¥—APIç®¡ç†å¤šç§è™šæ‹ŸåŒ–å¹³å°
- **è·¨å¹³å°æ€§**ï¼šæ”¯æŒLinuxã€Windowsç­‰å¤šç§æ“ä½œç³»ç»Ÿ  
- **åŠŸèƒ½å®Œæ•´**ï¼šæ¶µç›–è™šæ‹Ÿæœºã€ç½‘ç»œã€å­˜å‚¨çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **ç”Ÿæ€ä¸°å¯Œ**ï¼šä¼—å¤šç®¡ç†å·¥å…·åŸºäºlibvirtæ„å»º

### 1.2 æ¶æ„ç»„ä»¶è§£æ


**ğŸ›ï¸ æ•´ä½“æ¶æ„å›¾**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç®¡ç†å±‚                                â”‚
â”‚  virsh   virt-manager   virt-install   ç¬¬ä¸‰æ–¹åº”ç”¨       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   libvirt API                          â”‚
â”‚  åŸŸç®¡ç†API  ç½‘ç»œAPI  å­˜å‚¨API  èŠ‚ç‚¹API  äº‹ä»¶API          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 libvirtdå®ˆæŠ¤è¿›ç¨‹                        â”‚
â”‚  è¿æ¥ç®¡ç†  æƒé™æ§åˆ¶  é…ç½®è§£æ  çŠ¶æ€ç›‘æ§  æ—¥å¿—è®°å½•         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   é©±åŠ¨å±‚                                â”‚
â”‚   KVMé©±åŠ¨   Xené©±åŠ¨   ç½‘ç»œé©±åŠ¨   å­˜å‚¨é©±åŠ¨               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Hypervisorå±‚                           â”‚
â”‚     KVM        Xen       QEMU      LXC                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è§£**

| ç»„ä»¶ | **åŠŸèƒ½èŒè´£** | **ä½œç”¨èŒƒå›´** | **å…³é”®ç‰¹æ€§** |
|------|------------|------------|------------|
| ğŸ¯ **libvirt API** | `ç»Ÿä¸€æ¥å£æŠ½è±¡` | `è·¨Hypervisor` | `Cè¯­è¨€å®ç°ï¼Œå¤šè¯­è¨€ç»‘å®š` |
| âš™ï¸ **libvirtd** | `æ ¸å¿ƒå®ˆæŠ¤è¿›ç¨‹` | `ç³»ç»Ÿçº§æœåŠ¡` | `è¿æ¥ç®¡ç†ï¼Œå®‰å…¨æ§åˆ¶` |
| ğŸ”Œ **é©±åŠ¨æ¨¡å—** | `é€‚é…å…·ä½“å¹³å°` | `Hypervisoré€‚é…` | `å¯æ’æ‹”æ¶æ„ï¼ŒåŠ¨æ€åŠ è½½` |
| ğŸ› ï¸ **ç®¡ç†å·¥å…·** | `ç”¨æˆ·äº¤äº’ç•Œé¢` | `å‘½ä»¤è¡Œ/å›¾å½¢åŒ–` | `virshã€virt-managerç­‰` |

### 1.3 å·¥ä½œæµç¨‹æœºåˆ¶


**âš¡ å…¸å‹æ“ä½œæµç¨‹**
```
ç”¨æˆ·æ“ä½œè¯·æ±‚
    â†“
virsh/ç®¡ç†å·¥å…·
    â†“
libvirt APIè°ƒç”¨
    â†“
libvirtdå®ˆæŠ¤è¿›ç¨‹
    â†“
ç›¸åº”é©±åŠ¨æ¨¡å—
    â†“
åº•å±‚Hypervisor
    â†“
è™šæ‹Ÿæœºæ“ä½œæ‰§è¡Œ
    â†“
çŠ¶æ€åé¦ˆè¿”å›
```

---

## 2. âš™ï¸ libvirtdå®ˆæŠ¤è¿›ç¨‹é…ç½®


### 2.1 æœåŠ¡å¯åŠ¨ä¸ç®¡ç†


**ğŸš€ systemdæœåŠ¡ç®¡ç†**
- **å¯åŠ¨æœåŠ¡**ï¼š`systemctl start libvirtd`
- **å¼€æœºè‡ªå¯**ï¼š`systemctl enable libvirtd`  
- **æŸ¥çœ‹çŠ¶æ€**ï¼š`systemctl status libvirtd`
- **é‡å¯æœåŠ¡**ï¼š`systemctl restart libvirtd`

**ğŸ“Š æœåŠ¡çŠ¶æ€æ£€æŸ¥**
```
æœåŠ¡è¿è¡ŒçŠ¶æ€æ£€æŸ¥ï¼š
â— libvirtd.service - Virtualization daemon
   Loaded: loaded (/usr/lib/systemd/system/libvirtd.service)
   Active: active (running) since Mon 2025-01-20 10:30:15
   Process: 1234 ExecStart=/usr/sbin/libvirtd $LIBVIRTD_ARGS
   Main PID: 1234 (libvirtd)
   Tasks: 19 (limit: 32768)
```

### 2.2 ä¸»é…ç½®æ–‡ä»¶è¯¦è§£


**ğŸ“ `/etc/libvirt/libvirtd.conf` æ ¸å¿ƒé…ç½®**

**è¿æ¥ä¸ç›‘å¬é…ç½®**
```bash
# ç›‘å¬åœ°å€é…ç½®
listen_tls = 1                    # å¯ç”¨TLSè¿æ¥
listen_tcp = 0                    # ç¦ç”¨TCPæ˜æ–‡è¿æ¥
tls_port = "16514"               # TLSç«¯å£
tcp_port = "16509"               # TCPç«¯å£

# ç›‘å¬åœ°å€
listen_addr = "0.0.0.0"          # ç›‘å¬æ‰€æœ‰åœ°å€
```

**è®¤è¯ä¸å®‰å…¨é…ç½®**
```bash
# è®¤è¯æœºåˆ¶
auth_unix_ro = "none"            # åªè¯»è¿æ¥è®¤è¯
auth_unix_rw = "polkit"          # è¯»å†™è¿æ¥è®¤è¯  
auth_tcp = "sasl"                # TCPè¿æ¥è®¤è¯
auth_tls = "none"                # TLSè¿æ¥è®¤è¯

# è®¿é—®æ§åˆ¶
access_drivers = ["polkit"]       # è®¿é—®æ§åˆ¶é©±åŠ¨
```

**æ—¥å¿—ä¸è°ƒè¯•é…ç½®**
```bash
# æ—¥å¿—çº§åˆ«ï¼š1=ERROR 2=WARNING 3=INFO 4=DEBUG
log_level = 3
log_filters = "1:qemu 1:libxl 4:object 4:json 1:util"
log_outputs = "3:syslog:libvirtd"

# æ—¥å¿—æ–‡ä»¶
log_file = "/var/log/libvirt/libvirtd.log"
max_size = 2097152               # æ—¥å¿—æ–‡ä»¶æœ€å¤§2MB
max_backups = 3                  # ä¿ç•™3ä¸ªå¤‡ä»½
```

### 2.3 ç½‘ç»œä¸å­˜å‚¨é…ç½®


**ğŸŒ é»˜è®¤ç½‘ç»œé…ç½®æ£€æŸ¥**
```
é»˜è®¤è™šæ‹Ÿç½‘ç»œï¼š
åç§°: default
ç±»å‹: NATç½‘ç»œ
ç½‘æ®µ: 192.168.122.0/24
ç½‘å…³: 192.168.122.1
DHCP: 192.168.122.2-192.168.122.254
```

**ğŸ’¾ é»˜è®¤å­˜å‚¨æ± é…ç½®**
```
é»˜è®¤å­˜å‚¨æ± ï¼š
åç§°: default  
ç±»å‹: dir (ç›®å½•ç±»å‹)
è·¯å¾„: /var/lib/libvirt/images
æƒé™: qemu:qemu (ç”¨æˆ·ç»„)
```

### 2.4 æ€§èƒ½è°ƒä¼˜é…ç½®


**âš¡ æ€§èƒ½ç›¸å…³å‚æ•°**

| å‚æ•° | **é»˜è®¤å€¼** | **æ¨èå€¼** | **è¯´æ˜** |
|------|-----------|-----------|----------|
| `max_clients` | `5000` | `æ ¹æ®éœ€æ±‚è°ƒæ•´` | `æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°` |
| `max_workers` | `20` | `CPUæ ¸æ•°Ã—2` | `å·¥ä½œçº¿ç¨‹æ•°` |
| `max_requests` | `20` | `50-100` | `å•è¿æ¥æœ€å¤§è¯·æ±‚æ•°` |
| `keepalive_interval` | `5` | `30` | `è¿æ¥ä¿æ´»é—´éš”(ç§’)` |

---

## 3. ğŸ–¥ï¸ virshå‘½ä»¤è¡Œç®¡ç†å·¥å…·


### 3.1 virshåŸºç¡€æ“ä½œ


**ğŸ”¸ è¿æ¥ä¸è®¤è¯**
- **æœ¬åœ°è¿æ¥**ï¼š`virsh`
- **è¿œç¨‹è¿æ¥**ï¼š`virsh -c qemu+ssh://user@host/system`
- **åªè¯»è¿æ¥**ï¼š`virsh -r`
- **äº¤äº’æ¨¡å¼**ï¼š`virsh` è¿›å…¥äº¤äº’shell

**ğŸ“‹ åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢**

| å‘½ä»¤ | **åŠŸèƒ½** | **ç¤ºä¾‹è¾“å‡º** |
|------|---------|-------------|
| `version` | `æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯` | `libvirt 7.0.0, qemu 5.2.0` |
| `nodeinfo` | `æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯` | `CPUå‹å·ã€å†…å­˜ã€æ¶æ„ä¿¡æ¯` |
| `hostname` | `æŸ¥çœ‹ä¸»æœºå` | `kvm-host.example.com` |
| `uri` | `æŸ¥çœ‹è¿æ¥URI` | `qemu:///system` |

### 3.2 åŸŸ(è™šæ‹Ÿæœº)ç®¡ç†å‘½ä»¤


**ğŸ”¥ åŸŸç”Ÿå‘½å‘¨æœŸç®¡ç†**

**åˆ›å»ºä¸å¯åŠ¨**
```bash
# ä»XMLæ–‡ä»¶åˆ›å»ºåŸŸ
virsh define /path/to/domain.xml

# å¯åŠ¨åŸŸ
virsh start vm-name

# åˆ›å»ºå¹¶å¯åŠ¨(ä¸´æ—¶åŸŸ)
virsh create /path/to/domain.xml
```

**è¿è¡ŒçŠ¶æ€æ§åˆ¶**
```bash
# æŸ¥çœ‹æ‰€æœ‰åŸŸçŠ¶æ€
virsh list --all

# æš‚åœ/æ¢å¤åŸŸ
virsh suspend vm-name
virsh resume vm-name  

# é‡å¯åŸŸ
virsh reboot vm-name

# å¼ºåˆ¶å…³æœº
virsh destroy vm-name

# æ­£å¸¸å…³æœº  
virsh shutdown vm-name
```

**é…ç½®ç®¡ç†**
```bash
# å¯¼å‡ºåŸŸé…ç½®
virsh dumpxml vm-name > vm-backup.xml

# ç¼–è¾‘åŸŸé…ç½®
virsh edit vm-name

# å–æ¶ˆåŸŸå®šä¹‰
virsh undefine vm-name --remove-all-storage
```

### 3.3 èµ„æºç›‘æ§å‘½ä»¤


**ğŸ“Š æ€§èƒ½ç›‘æ§**

| ç›‘æ§ç±»å‹ | **å‘½ä»¤** | **ä¸»è¦ä¿¡æ¯** |
|---------|---------|-------------|
| ğŸ–¥ï¸ **CPUä½¿ç”¨** | `virsh cpu-stats vm-name` | `CPUæ—¶é—´ã€ä½¿ç”¨ç‡` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨** | `virsh dommemstat vm-name` | `å†…å­˜åˆ†é…ã€ä½¿ç”¨æƒ…å†µ` |
| ğŸ’¿ **ç£ç›˜IO** | `virsh domblkstat vm-name` | `è¯»å†™æ¬¡æ•°ã€å­—èŠ‚æ•°` |
| ğŸŒ **ç½‘ç»œIO** | `virsh domifstat vm-name` | `æ”¶å‘åŒ…æ•°ã€å­—èŠ‚æ•°` |

**å®æ—¶ç›‘æ§ç¤ºä¾‹**
```
CPUç»Ÿè®¡ä¿¡æ¯ï¼š
cpu_time          12345678900 ns
user_time         8234567890 ns  
system_time       4111111010 ns
vcpu_time         12345678900 ns

å†…å­˜ç»Ÿè®¡ä¿¡æ¯ï¼š
actual           1048576 KiB     # å®é™…ä½¿ç”¨å†…å­˜
unused           524288 KiB      # æœªä½¿ç”¨å†…å­˜
available        1572864 KiB     # å¯ç”¨å†…å­˜
```

### 3.4 é«˜çº§ç®¡ç†åŠŸèƒ½


**ğŸ’¾ å¿«ç…§ç®¡ç†**
```bash
# åˆ›å»ºå¿«ç…§
virsh snapshot-create-as vm-name snapshot1 "æè¿°ä¿¡æ¯"

# åˆ—å‡ºå¿«ç…§
virsh snapshot-list vm-name

# æ¢å¤å¿«ç…§
virsh snapshot-revert vm-name snapshot1

# åˆ é™¤å¿«ç…§  
virsh snapshot-delete vm-name snapshot1
```

**ğŸ”§ çƒ­æ’æ‹”æ“ä½œ**

> âš ï¸ **æ³¨æ„äº‹é¡¹**
> 
> çƒ­æ’æ‹”æ“ä½œéœ€è¦å®¢æˆ·æœºæ“ä½œç³»ç»Ÿå’Œé©±åŠ¨æ”¯æŒ

```bash
# çƒ­æ·»åŠ å†…å­˜
virsh setmem vm-name 2048M --live

# çƒ­æ·»åŠ CPU
virsh setvcpus vm-name 4 --live

# çƒ­æ·»åŠ ç£ç›˜
virsh attach-disk vm-name /path/to/disk.img vdb --live

# çƒ­æ·»åŠ ç½‘å¡
virsh attach-interface vm-name network default --live
```

---

## 4. ğŸ“„ XMLåŸŸé…ç½®æ–‡ä»¶è¯¦è§£


### 4.1 XMLåŸºæœ¬ç»“æ„


**ğŸ”¸ æ ‡å‡†åŸŸXMLç»“æ„**
```xml
<domain type='kvm'>
  <name>vm-name</name>
  <uuid>12345678-1234-1234-1234-123456789012</uuid>
  <memory unit='KiB'>1048576</memory>
  <currentMemory unit='KiB'>1048576</currentMemory>
  <vcpu placement='static'>2</vcpu>
  <os>...</os>
  <devices>...</devices>
</domain>
```

### 4.2 åŸºç¡€é…ç½®æ®µè¯¦è§£


**ğŸ†” åŸŸæ ‡è¯†ä¿¡æ¯**

| å…ƒç´  | **å¿…éœ€** | **è¯´æ˜** | **ç¤ºä¾‹** |
|------|---------|---------|----------|
| `<name>` | âœ… | `åŸŸåç§°ï¼Œåœ¨ä¸»æœºä¸Šå”¯ä¸€` | `web-server-01` |
| `<uuid>` | âŒ | `å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦` | `è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨æŒ‡å®š` |
| `<title>` | âŒ | `åŸŸæ ‡é¢˜æè¿°` | `WebæœåŠ¡å™¨` |
| `<description>` | âŒ | `è¯¦ç»†æè¿°ä¿¡æ¯` | `ç”Ÿäº§ç¯å¢ƒWebæœåŠ¡å™¨` |

**ğŸ’¾ å†…å­˜é…ç½®**
```xml
<memory unit='KiB'>2097152</memory>      <!-- æœ€å¤§å†…å­˜2GB -->
<currentMemory unit='KiB'>1048576</currentMemory>  <!-- å½“å‰åˆ†é…1GB -->

<!-- å†…å­˜åç«¯é…ç½®(NUMA) -->
<memoryBacking>
  <hugepages>
    <page size='1048576' unit='KiB' nodeset='0-1'/>
  </hugepages>
</memoryBacking>
```

**ğŸ–¥ï¸ CPUé…ç½®**
```xml
<vcpu placement='static'>4</vcpu>
<cpu mode='host-passthrough' check='none'>
  <topology sockets='2' cores='2' threads='1'/>
</cpu>
```

### 4.3 æ“ä½œç³»ç»Ÿé…ç½®


**âš™ï¸ OSå¯åŠ¨é…ç½®**
```xml
<os>
  <type arch='x86_64' machine='pc-i440fx-2.9'>hvm</type>
  <loader readonly='yes' type='pflash'>/usr/share/OVMF/OVMF_CODE.fd</loader>
  <nvram>/var/lib/libvirt/qemu/nvram/vm-name_VARS.fd</nvram>
  <boot dev='hd'/>
  <boot dev='cdrom'/>
</os>
```

**ğŸ”§ å¯åŠ¨é€‰é¡¹è¯´æ˜**

| é€‰é¡¹ | **è¯´æ˜** | **å¸¸ç”¨å€¼** |
|------|---------|-----------|
| `arch` | `CPUæ¶æ„` | `x86_64, aarch64, ppc64le` |
| `machine` | `æœºå™¨ç±»å‹` | `pc-i440fx, pc-q35, virt` |
| `boot dev` | `å¯åŠ¨è®¾å¤‡é¡ºåº` | `hd, cdrom, network, fd` |
| `loader` | `UEFIå›ºä»¶è·¯å¾„` | `OVMFè·¯å¾„` |

### 4.4 è®¾å¤‡é…ç½®è¯¦è§£


**ğŸ’¿ ç£ç›˜è®¾å¤‡é…ç½®**
```xml
<disk type='file' device='disk'>
  <driver name='qemu' type='qcow2' cache='writeback'/>
  <source file='/var/lib/libvirt/images/vm-disk.qcow2'/>
  <target dev='vda' bus='virtio'/>
  <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>
</disk>
```

**ğŸŒ ç½‘ç»œæ¥å£é…ç½®**
```xml
<interface type='network'>
  <source network='default'/>
  <model type='virtio'/>
  <mac address='52:54:00:12:34:56'/>
  <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
</interface>
```

**ğŸ–¥ï¸ VNCæ˜¾ç¤ºé…ç½®**
```xml
<graphics type='vnc' port='5900' autoport='yes' listen='127.0.0.1'>
  <listen type='address' address='127.0.0.1'/>
</graphics>
<video>
  <model type='cirrus' vram='16384' heads='1'/>
</video>
```

### 4.5 é«˜çº§é…ç½®é€‰é¡¹


**ğŸ”’ å®‰å…¨é…ç½®**
```xml
<seclabel type='dynamic' model='selinux' relabel='yes'/>
<seclabel type='dynamic' model='dac' relabel='yes'>
  <label>+107:+107</label>
  <imagelabel>+107:+107</imagelabel>
</seclabel>
```

**â° æ—¶é’Ÿé…ç½®**
```xml
<clock offset='utc'>
  <timer name='rtc' tickpolicy='catchup'/>
  <timer name='pit' tickpolicy='delay'/>
  <timer name='hpet' present='no'/>
</clock>
```

---

## 5. ğŸ”— è¿æ¥URIä¸è¿œç¨‹ç®¡ç†


### 5.1 URIæ ¼å¼è¯¦è§£


**ğŸ”¸ æ ‡å‡†URIæ ¼å¼**
```
[driver[+transport]://][username@][hostname][:port]/[path][?extraparameters]
```

**ğŸ“‹ å¸¸ç”¨URIç¤ºä¾‹**

| URIç±»å‹ | **ç¤ºä¾‹** | **è¯´æ˜** |
|---------|---------|----------|
| æœ¬åœ°ç³»ç»Ÿ | `qemu:///system` | `æœ¬åœ°KVMç³»ç»Ÿè¿æ¥` |
| æœ¬åœ°ä¼šè¯ | `qemu:///session` | `æœ¬åœ°ç”¨æˆ·ä¼šè¯è¿æ¥` |
| SSHè¿œç¨‹ | `qemu+ssh://user@host/system` | `SSHéš§é“è¿œç¨‹è¿æ¥` |
| TLSè¿œç¨‹ | `qemu+tls://host/system` | `TLSåŠ å¯†è¿œç¨‹è¿æ¥` |
| TCPè¿œç¨‹ | `qemu+tcp://host/system` | `TCPæ˜æ–‡è¿œç¨‹è¿æ¥` |

### 5.2 è¿œç¨‹è¿æ¥é…ç½®


**ğŸ” SSHè¿æ¥é…ç½®**

**æ­¥éª¤ 1ï¸âƒ£ï¼š** SSHå¯†é’¥è®¤è¯è®¾ç½®
```bash
# ç”Ÿæˆå¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096

# å¤åˆ¶å…¬é’¥åˆ°è¿œç¨‹ä¸»æœº
ssh-copy-id user@remote-host
```

**æ­¥éª¤ 2ï¸âƒ£ï¼š** æµ‹è¯•SSHè¿æ¥
```bash
# æµ‹è¯•SSHè¿æ¥
ssh user@remote-host "virsh list"

# virshè¿œç¨‹è¿æ¥
virsh -c qemu+ssh://user@remote-host/system list
```

**ğŸ”’ TLSå®‰å…¨è¿æ¥**

> ğŸ’¡ **ä¸“ä¸šæç¤º**
> 
> TLSè¿æ¥æä¾›åŠ å¯†å’Œè®¤è¯ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒè¿œç¨‹ç®¡ç†

**è¯ä¹¦é…ç½®ä½ç½®**
```
æœåŠ¡ç«¯è¯ä¹¦ï¼š/etc/pki/libvirt/
â”œâ”€â”€ ğŸ“„ cacert.pem          # CAè¯ä¹¦
â”œâ”€â”€ ğŸ“„ servercert.pem      # æœåŠ¡å™¨è¯ä¹¦  
â”œâ”€â”€ ğŸ” private/serverkey.pem  # æœåŠ¡å™¨ç§é’¥
â””â”€â”€ ğŸ“„ clientcert.pem      # å®¢æˆ·ç«¯è¯ä¹¦

å®¢æˆ·ç«¯è¯ä¹¦ï¼š~/.pki/libvirt/
â”œâ”€â”€ ğŸ“„ cacert.pem          # CAè¯ä¹¦
â”œâ”€â”€ ğŸ“„ clientcert.pem      # å®¢æˆ·ç«¯è¯ä¹¦
â””â”€â”€ ğŸ” private/clientkey.pem  # å®¢æˆ·ç«¯ç§é’¥
```

### 5.3 è¿æ¥ç®¡ç†æœ€ä½³å®è·µ


**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**

| åœºæ™¯ | **æ¨èè¿æ¥æ–¹å¼** | **åŸå› ** |
|------|----------------|----------|
| æœ¬åœ°ç®¡ç† | `qemu:///system` | `æ€§èƒ½æœ€ä½³ï¼Œæ— ç½‘ç»œå¼€é”€` |
| å®‰å…¨è¿œç¨‹ | `qemu+ssh://` | `SSHéš§é“ï¼Œå®‰å…¨æ€§é«˜` |
| é«˜é¢‘æ“ä½œ | `qemu+tls://` | `æŒä¹…è¿æ¥ï¼Œæ€§èƒ½å¥½` |
| è„šæœ¬è‡ªåŠ¨åŒ– | `qemu+tcp://` | `é…ç½®ç®€å•ï¼Œæ³¨æ„å®‰å…¨` |

**ğŸ”§ è¿æ¥æ•…éšœæ’æŸ¥**

**å¸¸è§é—®é¢˜è¯Šæ–­æµç¨‹**
```
è¿æ¥å¤±è´¥æ’æŸ¥ï¼š
â”œâ”€ 1. æ£€æŸ¥libvirtdæœåŠ¡çŠ¶æ€
â”œâ”€ 2. éªŒè¯ç½‘ç»œè¿é€šæ€§  
â”œâ”€ 3. ç¡®è®¤è®¤è¯é…ç½®
â”œâ”€ 4. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
â””â”€ 5. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
```

---

## 6. ğŸŒ ç½‘ç»œä¸å­˜å‚¨æ± ç®¡ç†


### 6.1 è™šæ‹Ÿç½‘ç»œç®¡ç†


**ğŸ”¸ ç½‘ç»œç±»å‹æ¦‚è¿°**

| ç½‘ç»œç±»å‹ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **é…ç½®å¤æ‚åº¦** |
|---------|---------|-------------|-------------|
| ğŸŒ‰ **NATç½‘ç»œ** | `è™šæ‹Ÿæœºè®¿é—®å¤–ç½‘ï¼Œå¤–ç½‘æ— æ³•ç›´æ¥è®¿é—®` | `å¼€å‘æµ‹è¯•ç¯å¢ƒ` | â­â­ |
| ğŸ”— **æ¡¥æ¥ç½‘ç»œ** | `è™šæ‹Ÿæœºè·å¾—ç‹¬ç«‹IPï¼Œå¦‚ç‰©ç†æœº` | `ç”Ÿäº§ç¯å¢ƒ` | â­â­â­â­ |
| ğŸ”’ **éš”ç¦»ç½‘ç»œ** | `è™šæ‹Ÿæœºé—´é€šä¿¡ï¼Œæ— æ³•è®¿é—®å¤–ç½‘` | `å®‰å…¨éš”ç¦»` | â­ |
| ğŸ  **Host-only** | `ä»…ä¸å®¿ä¸»æœºé€šä¿¡` | `ç®¡ç†ç½‘ç»œ` | â­â­ |

**ğŸ“Š ç½‘ç»œç®¡ç†å‘½ä»¤**
```bash
# åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ
virsh net-list --all

# æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯  
virsh net-dumpxml default

# å¯åŠ¨ç½‘ç»œ
virsh net-start default

# è®¾ç½®ç½‘ç»œè‡ªå¯åŠ¨
virsh net-autostart default

# åˆ›å»ºæ–°ç½‘ç»œ
virsh net-define network.xml
virsh net-start mynetwork
```

### 6.2 ç½‘ç»œé…ç½®å®ä¾‹


**ğŸŒ‰ NATç½‘ç»œé…ç½®ç¤ºä¾‹**
```xml
<network>
  <name>nat-network</name>
  <forward mode='nat'>
    <nat>
      <port start='1024' end='65535'/>
    </nat>
  </forward>
  <bridge name='virbr1' stp='on' delay='0'/>
  <ip address='192.168.100.1' netmask='255.255.255.0'>
    <dhcp>
      <range start='192.168.100.10' end='192.168.100.100'/>
    </dhcp>
  </ip>
</network>
```

**ğŸ”— æ¡¥æ¥ç½‘ç»œé…ç½®**
```bash
# åˆ›å»ºæ¡¥æ¥è®¾å¤‡
nmcli connection add type bridge ifname br0 con-name br0
nmcli connection add type ethernet ifname eth0 master br0 con-name br0-eth0
nmcli connection up br0
```

### 6.3 å­˜å‚¨æ± ç®¡ç†


**ğŸ”¸ å­˜å‚¨æ± ç±»å‹**

**ç›®å½•å­˜å‚¨æ±  (dir)**
```xml
<pool type='dir'>
  <name>default</name>
  <target>
    <path>/var/lib/libvirt/images</path>
    <permissions>
      <mode>0711</mode>
      <owner>107</owner>
      <group>107</group>
    </permissions>
  </target>
</pool>
```

**LVMå­˜å‚¨æ± **
```xml
<pool type='logical'>
  <name>lvm-pool</name>
  <source>
    <name>vg-libvirt</name>
  </source>
  <target>
    <path>/dev/vg-libvirt</path>
  </target>
</pool>
```

**ğŸ“‹ å­˜å‚¨æ± ç®¡ç†å‘½ä»¤**

| æ“ä½œ | **å‘½ä»¤** | **è¯´æ˜** |
|------|---------|----------|
| ğŸ“‹ **åˆ—å‡ºå­˜å‚¨æ± ** | `virsh pool-list --all` | `æ˜¾ç¤ºæ‰€æœ‰å­˜å‚¨æ± çŠ¶æ€` |
| â–¶ï¸ **å¯åŠ¨å­˜å‚¨æ± ** | `virsh pool-start pool-name` | `æ¿€æ´»å­˜å‚¨æ± ` |
| ğŸ”„ **è‡ªåŠ¨å¯åŠ¨** | `virsh pool-autostart pool-name` | `å¼€æœºè‡ªå¯åŠ¨` |
| ğŸ“Š **æŸ¥çœ‹ä¿¡æ¯** | `virsh pool-info pool-name` | `å­˜å‚¨æ± è¯¦ç»†ä¿¡æ¯` |
| ğŸ—‚ï¸ **åˆ—å‡ºå·** | `virsh vol-list pool-name` | `åˆ—å‡ºå­˜å‚¨å·` |

### 6.4 å­˜å‚¨å·æ“ä½œ


**ğŸ’¿ åˆ›å»ºå­˜å‚¨å·**
```bash
# åˆ›å»ºqcow2æ ¼å¼ç£ç›˜
virsh vol-create-as default vm-disk.qcow2 20G --format qcow2

# å…‹éš†å­˜å‚¨å·
virsh vol-clone --pool default original.qcow2 clone.qcow2

# è°ƒæ•´å·å¤§å°
virsh vol-resize --pool default vm-disk.qcow2 30G
```

**ğŸ”„ å­˜å‚¨å·è½¬æ¢**
```bash
# qcow2è½¬rawæ ¼å¼
qemu-img convert -f qcow2 -O raw source.qcow2 target.raw

# å‹ç¼©qcow2é•œåƒ
qemu-img convert -c -f qcow2 -O qcow2 source.qcow2 compressed.qcow2
```

---

## 7. ğŸ” æƒé™ä¸å®‰å…¨ç­–ç•¥


### 7.1 ç”¨æˆ·æƒé™ç®¡ç†


**ğŸ”¸ libvirtç”¨æˆ·ç»„**
```bash
# æ·»åŠ ç”¨æˆ·åˆ°libvirtç»„
usermod -a -G libvirt username

# æ·»åŠ ç”¨æˆ·åˆ°kvmç»„  
usermod -a -G kvm username

# éªŒè¯ç”¨æˆ·ç»„æˆå‘˜
groups username
```

**æƒé™çº§åˆ«è¯´æ˜**
```
ç³»ç»Ÿçº§æƒé™ (qemu:///system)ï¼š
âœ… å®Œæ•´çš„è™šæ‹Ÿæœºç®¡ç†æƒé™
âœ… ç½‘ç»œå’Œå­˜å‚¨é…ç½®æƒé™  
âœ… éœ€è¦rootæˆ–libvirtç»„æˆå‘˜

ç”¨æˆ·çº§æƒé™ (qemu:///session)ï¼š
ğŸ”¸ ä»…é™å½“å‰ç”¨æˆ·çš„è™šæ‹Ÿæœº
ğŸ”¸ å—é™çš„ç½‘ç»œå’Œå­˜å‚¨è®¿é—®
ğŸ”¸ æ— éœ€ç‰¹æ®Šæƒé™
```

### 7.2 PolicyKitè®¿é—®æ§åˆ¶


**ğŸ“‹ PolicyKitè§„åˆ™é…ç½®**

**æŸ¥çœ‹å½“å‰æƒé™**
```bash
# æŸ¥çœ‹libvirtç›¸å…³æƒé™
pkaction | grep libvirt

# æµ‹è¯•æƒé™
pkcheck -a org.libvirt.unix.manage -u username
```

**è‡ªå®šä¹‰æƒé™è§„åˆ™**
```javascript
/* /etc/polkit-1/rules.d/50-libvirt.rules */
polkit.addRule(function(action, subject) {
    if (action.id == "org.libvirt.unix.manage" &&
        subject.isInGroup("virt-users")) {
        return polkit.Result.YES;
    }
});
```

### 7.3 SELinuxå®‰å…¨ä¸Šä¸‹æ–‡


**ğŸ”’ SELinuxæ ‡ç­¾ç®¡ç†**

> âš ï¸ **é‡è¦è­¦å‘Š**
> 
> SELinuxé”™è¯¯é…ç½®å¯èƒ½å¯¼è‡´è™šæ‹Ÿæœºæ— æ³•å¯åŠ¨

**æ£€æŸ¥SELinuxçŠ¶æ€**
```bash
# æŸ¥çœ‹SELinuxçŠ¶æ€
getenforce

# æŸ¥çœ‹libvirtç›¸å…³ä¸Šä¸‹æ–‡
ps auxZ | grep libvirt

# æŸ¥çœ‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸Šä¸‹æ–‡  
ps auxZ | grep qemu
```

**é•œåƒæ–‡ä»¶æ ‡ç­¾**
```bash
# è®¾ç½®é•œåƒæ–‡ä»¶SELinuxæ ‡ç­¾
semanage fcontext -a -t virt_image_t "/custom/path/images(/.*)?"
restorecon -R /custom/path/images

# æŸ¥çœ‹æ–‡ä»¶æ ‡ç­¾
ls -Z /var/lib/libvirt/images/
```

### 7.4 é˜²ç«å¢™é…ç½®


**ğŸ”¥ iptablesè§„åˆ™**
```bash
# libvirté»˜è®¤åˆ›å»ºçš„è§„åˆ™é“¾
iptables -t nat -L LIBVIRT_PRT
iptables -t filter -L LIBVIRT_INP

# å…è®¸VNCè¿æ¥
iptables -A INPUT -p tcp --dport 5900:5999 -j ACCEPT

# å…è®¸libvirtç®¡ç†ç«¯å£
iptables -A INPUT -p tcp --dport 16509 -j ACCEPT  # TCP
iptables -A INPUT -p tcp --dport 16514 -j ACCEPT  # TLS
```

**firewalldé…ç½®**
```bash
# å¯ç”¨libvirtæœåŠ¡
firewall-cmd --permanent --add-service=libvirt
firewall-cmd --permanent --add-service=libvirt-tls

# æ·»åŠ VNCç«¯å£èŒƒå›´
firewall-cmd --permanent --add-port=5900-5999/tcp

# é‡è½½é…ç½®
firewall-cmd --reload
```

---

## 8. ğŸ”Œ APIæ¥å£ä¸ç¼–ç¨‹é›†æˆ


### 8.1 libvirt APIæ¦‚è¿°


**ğŸ”¸ APIè¯­è¨€ç»‘å®š**

| è¯­è¨€ | **ç»‘å®šåº“** | **æˆç†Ÿåº¦** | **ä½¿ç”¨åœºæ™¯** |
|------|-----------|-----------|-------------|
| ğŸ **Python** | `libvirt-python` | â­â­â­â­â­ | `è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œç®¡ç†å·¥å…·` |
| â˜• **Java** | `libvirt-java` | â­â­â­â­ | `ä¼ä¸šçº§åº”ç”¨` |
| ğŸŒ **Go** | `libvirt-go` | â­â­â­â­ | `äº‘åŸç”Ÿåº”ç”¨` |
| ğŸ’ **Ruby** | `ruby-libvirt` | â­â­â­ | `é…ç½®ç®¡ç†å·¥å…·` |
| ğŸ“˜ **C/C++** | `åŸç”ŸAPI` | â­â­â­â­â­ | `é«˜æ€§èƒ½åº”ç”¨` |

### 8.2 Python APIä½¿ç”¨ç¤ºä¾‹


**ğŸ åŸºç¡€è¿æ¥ä¸æŸ¥è¯¢**
```python
import libvirt

# è¿æ¥åˆ°libvirt
conn = libvirt.open('qemu:///system')
if conn is None:
    print('Failed to open connection to qemu:///system')
    exit(1)

# è·å–èŠ‚ç‚¹ä¿¡æ¯
nodeinfo = conn.getInfo()
print(f'ä¸»æœºæ¶æ„: {nodeinfo[0]}')
print(f'å†…å­˜å¤§å°: {nodeinfo[1]} MB')
print(f'CPUä¸ªæ•°: {nodeinfo[2]}')
print(f'CPUé¢‘ç‡: {nodeinfo[3]} MHz')

# åˆ—å‡ºæ‰€æœ‰åŸŸ
domains = conn.listAllDomains()
for domain in domains:
    print(f'åŸŸå: {domain.name()}, çŠ¶æ€: {domain.isActive()}')

conn.close()
```

**âš¡ è™šæ‹Ÿæœºæ“ä½œç¤ºä¾‹**
```python
# æ ¹æ®åç§°è·å–åŸŸå¯¹è±¡
domain = conn.lookupByName('vm-name')

# è·å–åŸŸçŠ¶æ€
state, reason = domain.state()
state_names = ['æ— çŠ¶æ€', 'è¿è¡Œä¸­', 'é˜»å¡', 'æš‚åœ', 'å…³æœºä¸­', 'å…³æœº', 'å´©æºƒ', 'æš‚åœä¸­']
print(f'åŸŸçŠ¶æ€: {state_names[state]}')

# è·å–åŸŸä¿¡æ¯
info = domain.info()
print(f'æœ€å¤§å†…å­˜: {info[1]} KB')
print(f'ä½¿ç”¨å†…å­˜: {info[2]} KB') 
print(f'è™šæ‹ŸCPU: {info[3]}')
print(f'CPUæ—¶é—´: {info[4]} ns')

# åŸŸæ“ä½œ
if not domain.isActive():
    domain.create()  # å¯åŠ¨åŸŸ
else:
    domain.suspend()  # æš‚åœåŸŸ
```

### 8.3 äº‹ä»¶ç›‘å¬æœºåˆ¶


**ğŸ“¡ äº‹ä»¶å›è°ƒå¤„ç†**
```python
# å®šä¹‰äº‹ä»¶å›è°ƒå‡½æ•°
def lifecycle_callback(conn, domain, event, detail, opaque):
    events = ['Defined', 'Undefined', 'Started', 'Suspended', 
              'Resumed', 'Stopped', 'Shutdown', 'PMSuspended', 
              'Crashed']
    print(f'åŸŸ {domain.name()} äº‹ä»¶: {events[event]}')

# æ³¨å†Œç”Ÿå‘½å‘¨æœŸäº‹ä»¶å›è°ƒ
conn.domainEventRegisterAny(None, 
                           libvirt.VIR_DOMAIN_EVENT_ID_LIFECYCLE,
                           lifecycle_callback, 
                           None)

# äº‹ä»¶å¾ªç¯
while True:
    libvirt.virEventRunDefaultImpl()
```

### 8.4 æ‰¹é‡ç®¡ç†è„šæœ¬


**ğŸ”„ æ‰¹é‡è™šæ‹Ÿæœºç®¡ç†**
```python
class VMManager:
    def __init__(self, uri='qemu:///system'):
        self.conn = libvirt.open(uri)
    
    def get_all_vms(self):
        """è·å–æ‰€æœ‰è™šæ‹Ÿæœºä¿¡æ¯"""
        vms = []
        for domain in self.conn.listAllDomains():
            vm_info = {
                'name': domain.name(),
                'uuid': domain.UUIDString(),
                'state': domain.isActive(),
                'vcpus': domain.info()[3],
                'memory': domain.info()[1] // 1024  # è½¬æ¢ä¸ºMB
            }
            vms.append(vm_info)
        return vms
    
    def batch_start(self, vm_names):
        """æ‰¹é‡å¯åŠ¨è™šæ‹Ÿæœº"""
        results = []
        for name in vm_names:
            try:
                domain = self.conn.lookupByName(name)
                if not domain.isActive():
                    domain.create()
                    results.append(f'âœ… {name}: å¯åŠ¨æˆåŠŸ')
                else:
                    results.append(f'â„¹ï¸ {name}: å·²åœ¨è¿è¡Œ')
            except Exception as e:
                results.append(f'âŒ {name}: {str(e)}')
        return results
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ libvirtæ¶æ„ï¼šç»Ÿä¸€API + libvirtdå®ˆæŠ¤è¿›ç¨‹ + é©±åŠ¨å±‚
ğŸ”¸ virshå·¥å…·ï¼šå‘½ä»¤è¡Œç®¡ç†ç•Œé¢ï¼Œæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹æ“ä½œ
ğŸ”¸ XMLé…ç½®ï¼šåŸŸå®šä¹‰çš„æ ‡å‡†æ ¼å¼ï¼Œæè¿°è™šæ‹Ÿæœºå®Œæ•´é…ç½®
ğŸ”¸ è¿æ¥URIï¼šä¸åŒè¿æ¥æ–¹å¼çš„ç»Ÿä¸€æ ‡è¯†æ ¼å¼
ğŸ”¸ ç½‘ç»œå­˜å‚¨ï¼šè™šæ‹ŸåŒ–ç¯å¢ƒçš„ç½‘ç»œå’Œå­˜å‚¨èµ„æºæ± ç®¡ç†
ğŸ”¸ æƒé™å®‰å…¨ï¼šå¤šå±‚æ¬¡çš„è®¿é—®æ§åˆ¶å’Œå®‰å…¨ç­–ç•¥
ğŸ”¸ APIç¼–ç¨‹ï¼šå¤šè¯­è¨€ç»‘å®šæ”¯æŒè‡ªåŠ¨åŒ–å’Œé›†æˆå¼€å‘
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ libvirtçš„æ ¸å¿ƒä»·å€¼**
```
ç»Ÿä¸€æŠ½è±¡ï¼š
- ä¸€å¥—APIç®¡ç†å¤šç§Hypervisor
- å±è”½åº•å±‚æŠ€æœ¯å·®å¼‚
- ç®€åŒ–è™šæ‹ŸåŒ–ç®¡ç†å¤æ‚åº¦

æ ‡å‡†åŒ–ï¼š
- XMLé…ç½®æ ¼å¼æ ‡å‡†
- ç»Ÿä¸€çš„å‘½ä»¤è¡Œæ¥å£  
- ä¸€è‡´çš„ç¼–ç¨‹æ¥å£
```

**ğŸ”¹ é…ç½®æ–‡ä»¶çš„é‡è¦æ€§**
```
å£°æ˜å¼é…ç½®ï¼š
- XMLæè¿°è™šæ‹Ÿæœºå®Œæ•´çŠ¶æ€
- ç‰ˆæœ¬æ§åˆ¶å‹å¥½
- æ˜“äºå¤‡ä»½å’Œè¿ç§»

çƒ­æ›´æ–°æ”¯æŒï¼š
- è¿è¡Œæ—¶é…ç½®ä¿®æ”¹
- æ— éœ€é‡å¯è™šæ‹Ÿæœº
- çµæ´»çš„èµ„æºè°ƒæ•´
```

**ğŸ”¹ å®‰å…¨ä¸æƒé™è®¾è®¡**
```
å¤šå±‚é˜²æŠ¤ï¼š
- ç³»ç»Ÿçº§æƒé™æ§åˆ¶
- PolicyKitç»†ç²’åº¦æˆæƒ
- SELinuxå¼ºåˆ¶è®¿é—®æ§åˆ¶
- ç½‘ç»œé˜²ç«å¢™è§„åˆ™

æœ€å°æƒé™åŸåˆ™ï¼š
- æŒ‰éœ€åˆ†é…æƒé™
- ç”¨æˆ·ä¼šè¯éš”ç¦»
- å®¡è®¡æ—¥å¿—è®°å½•
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒåº”ç”¨**
- **ä¼ä¸šè™šæ‹ŸåŒ–**ï¼šç»Ÿä¸€çš„è™šæ‹Ÿæœºç®¡ç†å¹³å°
- **äº‘è®¡ç®—åŸºç¡€**ï¼šOpenStackç­‰äº‘å¹³å°çš„åº•å±‚æ”¯æ’‘
- **å¼€å‘æµ‹è¯•**ï¼šå¿«é€Ÿåˆ›å»ºå’Œç®¡ç†æµ‹è¯•ç¯å¢ƒ
- **å®¹å™¨åŒ–æ”¯æŒ**ï¼šLXCå®¹å™¨çš„ç®¡ç†æ¥å£

**ğŸ”§ è¿ç»´ç®¡ç†**
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šåŸºäºXMLæ¨¡æ¿æ‰¹é‡åˆ›å»ºè™šæ‹Ÿæœº
- **èµ„æºç›‘æ§**ï¼šç»Ÿä¸€çš„æ€§èƒ½ç›‘æ§å’ŒæŠ¥è­¦
- **å¤‡ä»½æ¢å¤**ï¼šå¿«ç…§å’Œé…ç½®å¤‡ä»½æœºåˆ¶
- **æ•…éšœæ’æŸ¥**ï¼šå®Œå–„çš„æ—¥å¿—å’Œè¯Šæ–­å·¥å…·

### 9.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ¯ æŒæ¡ä¼˜å…ˆçº§**

**åŸºç¡€å¿…å¤‡** (ä¼˜å…ˆçº§: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥)
- virshåŸºæœ¬å‘½ä»¤
- XMLé…ç½®æ–‡ä»¶ç»“æ„
- ç½‘ç»œå’Œå­˜å‚¨åŸºç¡€æ¦‚å¿µ

**è¿›é˜¶æŠ€èƒ½** (ä¼˜å…ˆçº§: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥)
- è¿œç¨‹ç®¡ç†é…ç½®
- æƒé™å’Œå®‰å…¨ç­–ç•¥
- æ€§èƒ½è°ƒä¼˜å‚æ•°

**é«˜çº§åº”ç”¨** (ä¼˜å…ˆçº§: ğŸ”¥ğŸ”¥ğŸ”¥)
- APIç¼–ç¨‹å¼€å‘
- äº‹ä»¶ç›‘å¬å’Œå¤„ç†
- å¤§è§„æ¨¡é›†ç¾¤ç®¡ç†

### 9.5 å¸¸è§é—®é¢˜ä¸è§£å†³


**ğŸ› æ•…éšœæ’æŸ¥æ£€æŸ¥æ¸…å•**
- â˜‘ï¸ libvirtdæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- â˜‘ï¸ ç”¨æˆ·æƒé™æ˜¯å¦æ­£ç¡®é…ç½®
- â˜‘ï¸ SELinuxæ ‡ç­¾æ˜¯å¦è®¾ç½®æ­£ç¡®
- â˜‘ï¸ é˜²ç«å¢™è§„åˆ™æ˜¯å¦å…è®¸è¿æ¥
- â˜‘ï¸ XMLé…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡®
- â˜‘ï¸ å­˜å‚¨è·¯å¾„æƒé™æ˜¯å¦åˆé€‚
- â˜‘ï¸ ç½‘ç»œé…ç½®æ˜¯å¦å†²çª

**ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
- ğŸš€ ä½¿ç”¨virtioé©±åŠ¨æå‡IOæ€§èƒ½
- ğŸ”§ åˆç†é…ç½®CPUæ‹“æ‰‘ç»“æ„  
- ğŸ’¾ é€‰æ‹©åˆé€‚çš„ç£ç›˜ç¼“å­˜ç­–ç•¥
- ğŸŒ ä¼˜åŒ–ç½‘ç»œé˜Ÿåˆ—å’Œä¸­æ–­å¤„ç†
- ğŸ“Š å®šæœŸç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

**æ ¸å¿ƒè®°å¿†**ï¼š
- libvirtæ˜¯è™šæ‹ŸåŒ–ç®¡ç†çš„ç»Ÿä¸€æ¥å£
- virshæ˜¯æ—¥å¸¸ç®¡ç†çš„ä¸»è¦å·¥å…·
- XMLé…ç½®æ–‡ä»¶æ˜¯è™šæ‹Ÿæœºå®šä¹‰çš„æ ‡å‡†
- å®‰å…¨å’Œæƒé™é…ç½®ä¸å¯å¿½è§†
- APIç¼–ç¨‹æ”¯æŒè‡ªåŠ¨åŒ–å’Œé›†æˆå¼€å‘