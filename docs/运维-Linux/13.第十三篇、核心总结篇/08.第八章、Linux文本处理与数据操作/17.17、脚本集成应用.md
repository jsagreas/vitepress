---
title: 17ã€è„šæœ¬é›†æˆåº”ç”¨
---
## ğŸ“š ç›®å½•

1. [Shellè„šæœ¬ä¸­å·¥å…·ç»„åˆä½¿ç”¨](#1-Shellè„šæœ¬ä¸­å·¥å…·ç»„åˆä½¿ç”¨)
2. [é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•è·](#2-é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•è·)
3. [å‚æ•°éªŒè¯ä¸è¾“å…¥æ£€æŸ¥](#3-å‚æ•°éªŒè¯ä¸è¾“å…¥æ£€æŸ¥)
4. [å¤„ç†ç»“æœçŠ¶æ€æ£€æµ‹](#4-å¤„ç†ç»“æœçŠ¶æ€æ£€æµ‹)
5. [è„šæœ¬è°ƒè¯•ä¸æ—¥å¿—è®°å½•](#5-è„šæœ¬è°ƒè¯•ä¸æ—¥å¿—è®°å½•)
6. [å¯é‡ç”¨å‡½æ•°å°è£…](#6-å¯é‡ç”¨å‡½æ•°å°è£…)
7. [è„šæœ¬æ€§èƒ½ç›‘æ§](#7-è„šæœ¬æ€§èƒ½ç›‘æ§)
8. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ³¨æ„äº‹é¡¹](#8-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ³¨æ„äº‹é¡¹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ Shellè„šæœ¬ä¸­å·¥å…·ç»„åˆä½¿ç”¨


### 1.1 ä»€ä¹ˆæ˜¯å·¥å…·ç»„åˆä½¿ç”¨


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šåœ¨Shellè„šæœ¬ä¸­å°†å¤šä¸ªLinuxæ–‡æœ¬å¤„ç†å·¥å…·ä¸²è”èµ·æ¥ï¼Œå½¢æˆå®Œæ•´çš„æ•°æ®å¤„ç†æµç¨‹ã€‚å°±åƒå·¥å‚çš„æµæ°´çº¿ä¸€æ ·ï¼Œæ¯ä¸ªå·¥å…·è´Ÿè´£ä¸€ä¸ªç‰¹å®šçš„å¤„ç†ç¯èŠ‚ï¼Œæœ€ç»ˆå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚

**åŸºæœ¬æ€æƒ³**ï¼š
- **ç®¡é“è¿æ¥**ï¼šç”¨ `|` å°†å·¥å…·è¿æ¥ï¼Œå‰ä¸€ä¸ªå·¥å…·çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå·¥å…·çš„è¾“å…¥
- **åŠŸèƒ½äº’è¡¥**ï¼šæ¯ä¸ªå·¥å…·ä¸“ç²¾æŸä¸ªæ–¹é¢ï¼Œç»„åˆååŠŸèƒ½å¼ºå¤§
- **æ•°æ®æµè½¬**ï¼šæ•°æ®åƒæ°´æµä¸€æ ·åœ¨å·¥å…·é—´ä¼ é€’å’Œå˜æ¢

### 1.2 å¸¸ç”¨å·¥å…·ç»„åˆæ¨¡å¼


**ğŸ”¸ æ•°æ®æ¸…æ´—ç»„åˆ**
```bash
# æ¨¡å¼ï¼šè¿‡æ»¤ â†’ å»é‡ â†’ æ’åº â†’ æ ¼å¼åŒ–
grep "pattern" file.txt | sort | uniq | awk '{print "å¤„ç†å:", $0}'
```

**ğŸ”¸ ç»Ÿè®¡åˆ†æç»„åˆ**
```bash
# æ¨¡å¼ï¼šæå– â†’ è®¡æ•° â†’ æ’åº â†’ å–å‰N
cut -d',' -f3 data.csv | sort | uniq -c | sort -nr | head -10
```

**ğŸ”¸ æ–‡æœ¬è½¬æ¢ç»„åˆ**
```bash
# æ¨¡å¼ï¼šæ›¿æ¢ â†’ æ ¼å¼åŒ– â†’ è¾“å‡º
sed 's/old/new/g' file.txt | awk '{printf "%-20s %s\n", $1, $2}' > result.txt
```

### 1.3 å®é™…ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹


**ğŸ“Š æ—¥å¿—åˆ†æè„šæœ¬**
```bash
#!/bin/bash
# åˆ†æApacheè®¿é—®æ—¥å¿—ï¼Œæ‰¾å‡ºè®¿é—®é‡æœ€é«˜çš„IP

analyze_access_log() {
    local logfile=$1
    
    # å·¥å…·ç»„åˆæµç¨‹å›¾
    # åŸå§‹æ—¥å¿— â†’ awkæå–IP â†’ sortæ’åº â†’ uniqè®¡æ•° â†’ sortæŒ‰æ•°é‡æ’åº â†’ headå–å‰10
    
    echo "=== è®¿é—®é‡æœ€é«˜çš„10ä¸ªIP ==="
    awk '{print $1}' "$logfile" \
    | sort \
    | uniq -c \
    | sort -nr \
    | head -10 \
    | awk '{printf "IP: %-15s è®¿é—®æ¬¡æ•°: %d\n", $2, $1}'
}

# è°ƒç”¨å‡½æ•°
analyze_access_log "/var/log/apache2/access.log"
```

**ğŸ’¾ æ•°æ®æŠ¥è¡¨ç”Ÿæˆ**
```bash
#!/bin/bash
# ç”Ÿæˆé”€å”®æ•°æ®æŠ¥è¡¨

generate_sales_report() {
    local data_file=$1
    local output_file=$2
    
    echo "ç”Ÿæˆé”€å”®æŠ¥è¡¨ä¸­..."
    
    # å¤„ç†æµç¨‹ï¼š
    # CSVæ•°æ® â†’ å»é™¤æ ‡é¢˜è¡Œ â†’ æŒ‰åœ°åŒºåˆ†ç»„ â†’ è®¡ç®—æ€»é”€å”®é¢ â†’ æ ¼å¼åŒ–è¾“å‡º
    {
        echo "åœ°åŒºæŠ¥è¡¨ - $(date '+%Y-%m-%d %H:%M:%S')"
        echo "=================================="
        
        tail -n +2 "$data_file" \
        | awk -F',' '
            {
                # $2æ˜¯åœ°åŒºï¼Œ$4æ˜¯é”€å”®é¢
                region[$2] += $4
            }
            END {
                for (r in region) {
                    printf "%-12s %10.2f\n", r, region[r]
                }
            }' \
        | sort -k2 -nr
        
    } > "$output_file"
    
    echo "æŠ¥è¡¨å·²ç”Ÿæˆï¼š$output_file"
}
```

---

## 2. âš ï¸ é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•è·


### 2.1 ä¸ºä»€ä¹ˆéœ€è¦é”™è¯¯å¤„ç†


åœ¨è„šæœ¬ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç¯èŠ‚éƒ½å¯èƒ½å‡ºé”™ï¼š
- **æ–‡ä»¶ä¸å­˜åœ¨**ï¼šè¯•å›¾å¤„ç†ä¸å­˜åœ¨çš„æ–‡ä»¶
- **æƒé™ä¸è¶³**ï¼šæ— æ³•è¯»å–æˆ–å†™å…¥æ–‡ä»¶
- **å‘½ä»¤å¤±è´¥**ï¼šå·¥å…·æ‰§è¡Œå¤±è´¥æˆ–è¿”å›é”™è¯¯
- **æ•°æ®æ ¼å¼é”™è¯¯**ï¼šè¾“å…¥æ•°æ®æ ¼å¼ä¸ç¬¦åˆé¢„æœŸ

**ä¸å¤„ç†é”™è¯¯çš„åæœ**ï¼š
- è„šæœ¬é»˜é»˜å¤±è´¥ï¼Œäº§ç”Ÿé”™è¯¯ç»“æœ
- æµªè´¹æ—¶é—´å¤„ç†æ— æ•ˆæ•°æ®
- å½±å“åç»­æµç¨‹

### 2.2 åŸºæœ¬é”™è¯¯æ£€æµ‹æœºåˆ¶


**ğŸ”¸ æ£€æŸ¥å‘½ä»¤æ‰§è¡ŒçŠ¶æ€**

æ¯ä¸ªå‘½ä»¤æ‰§è¡Œåéƒ½ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼ˆé€€å‡ºç ï¼‰ï¼š
- `0`ï¼šæˆåŠŸ
- `é0`ï¼šå¤±è´¥ï¼ˆå…·ä½“æ•°å­—ä»£è¡¨ä¸åŒé”™è¯¯ç±»å‹ï¼‰

```bash
# åŸºæœ¬é”™è¯¯æ£€æµ‹
if ! grep "pattern" file.txt > /dev/null 2>&1; then
    echo "é”™è¯¯ï¼šæœªæ‰¾åˆ°åŒ¹é…çš„å†…å®¹æˆ–æ–‡ä»¶ä¸å­˜åœ¨"
    exit 1
fi

# ä½¿ç”¨ $? æ£€æŸ¥ä¸Šä¸€ä¸ªå‘½ä»¤çš„çŠ¶æ€
grep "pattern" file.txt > result.txt
if [ $? -ne 0 ]; then
    echo "grepå‘½ä»¤æ‰§è¡Œå¤±è´¥"
    exit 1
fi
```

**ğŸ”¸ æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥**
```bash
check_file_exists() {
    local file=$1
    
    if [ ! -f "$file" ]; then
        echo "é”™è¯¯ï¼šæ–‡ä»¶ '$file' ä¸å­˜åœ¨"
        return 1
    fi
    
    if [ ! -r "$file" ]; then
        echo "é”™è¯¯ï¼šæ–‡ä»¶ '$file' æ— è¯»å–æƒé™"
        return 1
    fi
    
    return 0
}

# ä½¿ç”¨ç¤ºä¾‹
if ! check_file_exists "data.txt"; then
    exit 1
fi
```

### 2.3 setå‘½ä»¤å¢å¼ºé”™è¯¯å¤„ç†


**ğŸ”¸ å…³é”®çš„seté€‰é¡¹**

| é€‰é¡¹ | å«ä¹‰ | ä½œç”¨ |
|------|------|------|
| `set -e` | é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º | ä»»ä½•å‘½ä»¤å¤±è´¥å°±åœæ­¢è„šæœ¬ |
| `set -u` | ä½¿ç”¨æœªå®šä¹‰å˜é‡æŠ¥é”™ | é˜²æ­¢å˜é‡æ‹¼å†™é”™è¯¯ |
| `set -o pipefail` | ç®¡é“ä¸­ä»»ä½•å‘½ä»¤å¤±è´¥å°±å¤±è´¥ | ç¡®ä¿ç®¡é“ä¸­çš„é”™è¯¯è¢«æ•è· |

```bash
#!/bin/bash
# åœ¨è„šæœ¬å¼€å¤´è®¾ç½®ä¸¥æ ¼æ¨¡å¼
set -euo pipefail

# ç°åœ¨ä»»ä½•é”™è¯¯éƒ½ä¼šå¯¼è‡´è„šæœ¬ç«‹å³åœæ­¢
process_data() {
    local input_file=$1
    
    # å¦‚æœä»»ä½•ä¸€ä¸ªå‘½ä»¤å¤±è´¥ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨é€€å‡º
    grep "important" "$input_file" \
    | sort \
    | uniq \
    | wc -l
}
```

### 2.4 ä¼˜é›…çš„é”™è¯¯å¤„ç†å®ä¾‹


```bash
#!/bin/bash
set -euo pipefail

# é”™è¯¯å¤„ç†å‡½æ•°
handle_error() {
    echo "âŒ é”™è¯¯å‘ç”Ÿåœ¨ç¬¬ $1 è¡Œï¼Œå‘½ä»¤ï¼š$2"
    echo "ğŸ“‹ æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
    rm -f /tmp/process_*
    exit 1
}

# è®¾ç½®é”™è¯¯æ•è·
trap 'handle_error $LINENO "$BASH_COMMAND"' ERR

process_log_files() {
    local log_dir=$1
    local output_file=$2
    
    echo "ğŸ” å¼€å§‹å¤„ç†æ—¥å¿—æ–‡ä»¶..."
    
    # æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
    [ -d "$log_dir" ] || {
        echo "âŒ æ—¥å¿—ç›®å½•ä¸å­˜åœ¨: $log_dir"
        return 1
    }
    
    # æ£€æŸ¥æ˜¯å¦æœ‰æ—¥å¿—æ–‡ä»¶
    if [ -z "$(find "$log_dir" -name '*.log' -type f)" ]; then
        echo "âš ï¸  è­¦å‘Šï¼šç›®å½•ä¸­æ²¡æœ‰æ‰¾åˆ° .log æ–‡ä»¶"
        return 0
    fi
    
    # å¤„ç†æ–‡ä»¶
    find "$log_dir" -name '*.log' -type f \
    | while read -r logfile; do
        echo "ğŸ“„ å¤„ç†æ–‡ä»¶: $(basename "$logfile")"
        
        # æ¯ä¸ªæ–‡ä»¶å•ç‹¬é”™è¯¯å¤„ç†
        if ! process_single_log "$logfile"; then
            echo "âš ï¸  è­¦å‘Šï¼šæ–‡ä»¶ $logfile å¤„ç†å¤±è´¥ï¼Œè·³è¿‡"
            continue
        fi
    done > "$output_file"
    
    echo "âœ… å¤„ç†å®Œæˆï¼Œç»“æœä¿å­˜åˆ°: $output_file"
}

process_single_log() {
    local logfile=$1
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯è¯»
    [ -r "$logfile" ] || return 1
    
    # å®é™…å¤„ç†é€»è¾‘
    awk '/ERROR|WARN/ {print FILENAME, $0}' "$logfile" 2>/dev/null
}
```

---

## 3. âœ… å‚æ•°éªŒè¯ä¸è¾“å…¥æ£€æŸ¥


### 3.1 ä¸ºä»€ä¹ˆè¦éªŒè¯å‚æ•°


**å¸¸è§é—®é¢˜**ï¼š
- ç”¨æˆ·å¿˜è®°æä¾›å¿…éœ€å‚æ•°
- å‚æ•°æ ¼å¼ä¸æ­£ç¡®
- å‚æ•°å€¼è¶…å‡ºåˆç†èŒƒå›´
- æä¾›äº†ä¸å­˜åœ¨çš„æ–‡ä»¶è·¯å¾„

**éªŒè¯çš„å¥½å¤„**ï¼š
- æå‰å‘ç°é—®é¢˜ï¼Œé¿å…æµªè´¹æ—¶é—´
- ç»™ç”¨æˆ·æ¸…æ™°çš„é”™è¯¯æç¤º
- è®©è„šæœ¬æ›´åŠ å¥å£®å¯é 

### 3.2 åŸºç¡€å‚æ•°éªŒè¯


**ğŸ”¸ å‚æ•°æ•°é‡æ£€æŸ¥**
```bash
#!/bin/bash

# æ˜¾ç¤ºç”¨æ³•ä¿¡æ¯
show_usage() {
    echo "ç”¨æ³•: $0 <è¾“å…¥æ–‡ä»¶> <è¾“å‡ºæ–‡ä»¶> [é€‰é¡¹]"
    echo ""
    echo "å‚æ•°è¯´æ˜:"
    echo "  è¾“å…¥æ–‡ä»¶    è¦å¤„ç†çš„æ•°æ®æ–‡ä»¶"
    echo "  è¾“å‡ºæ–‡ä»¶    å¤„ç†ç»“æœä¿å­˜ä½ç½®"
    echo "  é€‰é¡¹        å¯é€‰çš„å¤„ç†é€‰é¡¹"
    echo ""
    echo "ç¤ºä¾‹:"
    echo "  $0 data.txt result.txt"
    echo "  $0 logs/*.log summary.txt --verbose"
}

# æ£€æŸ¥å‚æ•°æ•°é‡
if [ $# -lt 2 ]; then
    echo "âŒ é”™è¯¯ï¼šå‚æ•°ä¸è¶³"
    show_usage
    exit 1
fi

if [ $# -gt 4 ]; then
    echo "âŒ é”™è¯¯ï¼šå‚æ•°è¿‡å¤š"
    show_usage
    exit 1
fi
```

**ğŸ”¸ å‚æ•°ç±»å‹å’Œæ ¼å¼éªŒè¯**
```bash
validate_parameters() {
    local input_file=$1
    local output_file=$2
    local option=${3:-""}
    
    # éªŒè¯è¾“å…¥æ–‡ä»¶
    if [ ! -f "$input_file" ]; then
        echo "âŒ é”™è¯¯ï¼šè¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨: $input_file"
        return 1
    fi
    
    if [ ! -r "$input_file" ]; then
        echo "âŒ é”™è¯¯ï¼šè¾“å…¥æ–‡ä»¶æ— è¯»å–æƒé™: $input_file"
        return 1
    fi
    
    # éªŒè¯è¾“å‡ºæ–‡ä»¶è·¯å¾„
    local output_dir=$(dirname "$output_file")
    if [ ! -d "$output_dir" ]; then
        echo "âŒ é”™è¯¯ï¼šè¾“å‡ºç›®å½•ä¸å­˜åœ¨: $output_dir"
        return 1
    fi
    
    if [ ! -w "$output_dir" ]; then
        echo "âŒ é”™è¯¯ï¼šè¾“å‡ºç›®å½•æ— å†™å…¥æƒé™: $output_dir"
        return 1
    fi
    
    # éªŒè¯é€‰é¡¹å‚æ•°
    if [ -n "$option" ]; then
        case "$option" in
            --verbose|--quiet|--debug)
                # æœ‰æ•ˆé€‰é¡¹
                ;;
            *)
                echo "âŒ é”™è¯¯ï¼šä¸æ”¯æŒçš„é€‰é¡¹: $option"
                echo "æ”¯æŒçš„é€‰é¡¹: --verbose, --quiet, --debug"
                return 1
                ;;
        esac
    fi
    
    return 0
}

# ä½¿ç”¨éªŒè¯å‡½æ•°
input_file=$1
output_file=$2
option=${3:-""}

if ! validate_parameters "$input_file" "$output_file" "$option"; then
    exit 1
fi

echo "âœ… å‚æ•°éªŒè¯é€šè¿‡"
```

### 3.3 é«˜çº§éªŒè¯æŠ€å·§


**ğŸ”¸ æ–‡ä»¶ç±»å‹éªŒè¯**
```bash
validate_file_type() {
    local file=$1
    local expected_type=$2
    
    case "$expected_type" in
        "csv")
            if ! head -1 "$file" | grep -q ","; then
                echo "âŒ é”™è¯¯ï¼šæ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆçš„CSVæ ¼å¼"
                return 1
            fi
            ;;
        "log")
            if ! file "$file" | grep -q "text"; then
                echo "âŒ é”™è¯¯ï¼šæ–‡ä»¶ä¸æ˜¯æ–‡æœ¬æ ¼å¼çš„æ—¥å¿—æ–‡ä»¶"
                return 1
            fi
            ;;
        "json")
            if ! python -m json.tool "$file" >/dev/null 2>&1; then
                echo "âŒ é”™è¯¯ï¼šæ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼"
                return 1
            fi
            ;;
    esac
    
    return 0
}
```

**ğŸ”¸ æ•°å€¼èŒƒå›´éªŒè¯**
```bash
validate_number_range() {
    local value=$1
    local min=$2
    local max=$3
    local name=$4
    
    # æ£€æŸ¥æ˜¯å¦ä¸ºæ•°å­—
    if ! [[ "$value" =~ ^[0-9]+$ ]]; then
        echo "âŒ é”™è¯¯ï¼š$name å¿…é¡»æ˜¯æ•°å­—ï¼Œå¾—åˆ°: $value"
        return 1
    fi
    
    # æ£€æŸ¥èŒƒå›´
    if [ "$value" -lt "$min" ] || [ "$value" -gt "$max" ]; then
        echo "âŒ é”™è¯¯ï¼š$name å¿…é¡»åœ¨ $min-$max ä¹‹é—´ï¼Œå¾—åˆ°: $value"
        return 1
    fi
    
    return 0
}

# ä½¿ç”¨ç¤ºä¾‹
if ! validate_number_range "$thread_count" 1 10 "çº¿ç¨‹æ•°é‡"; then
    exit 1
fi
```

---

## 4. ğŸ“Š å¤„ç†ç»“æœçŠ¶æ€æ£€æµ‹


### 4.1 ä»€ä¹ˆæ˜¯ç»“æœçŠ¶æ€æ£€æµ‹


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šåœ¨è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ä»…è¦æ£€æµ‹å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œè¿˜è¦éªŒè¯å¤„ç†ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

**æ£€æµ‹ç»´åº¦**ï¼š
- **æ‰§è¡ŒçŠ¶æ€**ï¼šå‘½ä»¤æ˜¯å¦æˆåŠŸè¿è¡Œ
- **è¾“å‡ºè´¨é‡**ï¼šç»“æœæ˜¯å¦æœ‰æ„ä¹‰
- **æ•°æ®å®Œæ•´æ€§**ï¼šå¤„ç†åçš„æ•°æ®æ˜¯å¦å®Œæ•´
- **æ ¼å¼æ­£ç¡®æ€§**ï¼šè¾“å‡ºæ ¼å¼æ˜¯å¦æ­£ç¡®

### 4.2 åŸºæœ¬çŠ¶æ€æ£€æµ‹æ–¹æ³•


**ğŸ”¸ å‘½ä»¤æ‰§è¡ŒçŠ¶æ€æ£€æµ‹**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ && å’Œ || æ“ä½œç¬¦
process_data() {
    local input_file=$1
    local output_file=$2
    
    echo "å¼€å§‹å¤„ç†æ•°æ®..."
    
    # æ‰§è¡Œå¤„ç†å¹¶æ£€æµ‹çŠ¶æ€
    awk -F',' '{sum+=$3} END {print "æ€»è®¡:", sum}' "$input_file" > "$output_file" \
    && echo "âœ… æ•°æ®å¤„ç†æˆåŠŸ" \
    || { echo "âŒ æ•°æ®å¤„ç†å¤±è´¥"; return 1; }
    
    # æ£€æŸ¥è¾“å‡ºæ–‡ä»¶æ˜¯å¦ä¸ºç©º
    if [ ! -s "$output_file" ]; then
        echo "âš ï¸  è­¦å‘Šï¼šè¾“å‡ºæ–‡ä»¶ä¸ºç©º"
        return 1
    fi
    
    return 0
}
```

**ğŸ”¸ ç®¡é“ä¸­çš„çŠ¶æ€æ£€æµ‹**
```bash
# ä½¿ç”¨ ${PIPESTATUS[@]} æ£€æµ‹ç®¡é“ä¸­æ¯ä¸ªå‘½ä»¤çš„çŠ¶æ€
process_with_pipeline() {
    local input_file=$1
    
    # å¤æ‚çš„ç®¡é“æ“ä½œ
    grep "IMPORTANT" "$input_file" \
    | sort -k2 -n \
    | uniq -c \
    | awk '{print $2, $1}' > result.txt
    
    # æ£€æŸ¥ç®¡é“ä¸­æ¯ä¸ªå‘½ä»¤çš„çŠ¶æ€
    pipe_status=(${PIPESTATUS[@]})
    
    if [ ${pipe_status[0]} -ne 0 ]; then
        echo "âŒ grep å‘½ä»¤å¤±è´¥"
        return 1
    fi
    
    if [ ${pipe_status[1]} -ne 0 ]; then
        echo "âŒ sort å‘½ä»¤å¤±è´¥" 
        return 1
    fi
    
    if [ ${pipe_status[2]} -ne 0 ]; then
        echo "âŒ uniq å‘½ä»¤å¤±è´¥"
        return 1
    fi
    
    if [ ${pipe_status[3]} -ne 0 ]; then
        echo "âŒ awk å‘½ä»¤å¤±è´¥"
        return 1
    fi
    
    echo "âœ… ç®¡é“å¤„ç†å…¨éƒ¨æˆåŠŸ"
    return 0
}
```

### 4.3 ç»“æœè´¨é‡æ£€æµ‹


**ğŸ”¸ æ•°æ®å®Œæ•´æ€§æ£€æµ‹**
```bash
validate_processing_result() {
    local input_file=$1
    local output_file=$2
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if [ ! -f "$output_file" ]; then
        echo "âŒ è¾“å‡ºæ–‡ä»¶æœªåˆ›å»º"
        return 1
    fi
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
    if [ ! -s "$output_file" ]; then
        echo "âŒ è¾“å‡ºæ–‡ä»¶ä¸ºç©º"
        return 1
    fi
    
    # æ¯”è¾ƒè¡Œæ•°ï¼ˆç¡®ä¿æ²¡æœ‰æ•°æ®ä¸¢å¤±ï¼‰
    input_lines=$(wc -l < "$input_file")
    output_lines=$(wc -l < "$output_file")
    
    echo "ğŸ“Š æ•°æ®ç»Ÿè®¡ï¼š"
    echo "   è¾“å…¥è¡Œæ•°: $input_lines"
    echo "   è¾“å‡ºè¡Œæ•°: $output_lines"
    
    # æ£€æŸ¥æ•°æ®é‡æ˜¯å¦åˆç†
    if [ "$output_lines" -eq 0 ]; then
        echo "âš ï¸  è­¦å‘Šï¼šè¾“å‡ºæ²¡æœ‰æ•°æ®è¡Œ"
        return 1
    fi
    
    # å¯¹äºè¿‡æ»¤æ“ä½œï¼Œè¾“å‡ºåº”è¯¥å°‘äºç­‰äºè¾“å…¥
    if [ "$output_lines" -gt "$input_lines" ]; then
        echo "âš ï¸  è­¦å‘Šï¼šè¾“å‡ºè¡Œæ•°å¤šäºè¾“å…¥ï¼Œå¯èƒ½æœ‰é‡å¤"
    fi
    
    return 0
}
```

**ğŸ”¸ æ ¼å¼æ­£ç¡®æ€§æ£€æµ‹**
```bash
validate_csv_output() {
    local csv_file=$1
    local expected_columns=$2
    
    # æ£€æŸ¥ç¬¬ä¸€è¡Œï¼ˆæ ‡é¢˜è¡Œï¼‰çš„åˆ—æ•°
    header_cols=$(head -1 "$csv_file" | awk -F',' '{print NF}')
    
    if [ "$header_cols" -ne "$expected_columns" ]; then
        echo "âŒ CSVæ ¼å¼é”™è¯¯ï¼šæœŸæœ› $expected_columns åˆ—ï¼Œå®é™… $header_cols åˆ—"
        return 1
    fi
    
    # æ£€æŸ¥æ‰€æœ‰è¡Œçš„åˆ—æ•°æ˜¯å¦ä¸€è‡´
    inconsistent_lines=$(awk -F',' -v expect="$expected_columns" \
        'NF != expect {print NR ": " NF " columns"}' "$csv_file")
    
    if [ -n "$inconsistent_lines" ]; then
        echo "âŒ å‘ç°æ ¼å¼ä¸ä¸€è‡´çš„è¡Œï¼š"
        echo "$inconsistent_lines"
        return 1
    fi
    
    echo "âœ… CSVæ ¼å¼éªŒè¯é€šè¿‡"
    return 0
}
```

### 4.4 ç»¼åˆçŠ¶æ€æ£€æµ‹ç¤ºä¾‹


```bash
#!/bin/bash
set -euo pipefail

# ç»¼åˆå¤„ç†å‡½æ•°ï¼ŒåŒ…å«å®Œæ•´çš„çŠ¶æ€æ£€æµ‹
comprehensive_data_processing() {
    local input_file=$1
    local output_file=$2
    local temp_file="/tmp/processing_$$.tmp"
    
    echo "ğŸ”„ å¼€å§‹ç»¼åˆæ•°æ®å¤„ç†..."
    
    # é˜¶æ®µ1ï¼šæ•°æ®æ¸…æ´—
    echo "ğŸ“‹ é˜¶æ®µ1ï¼šæ•°æ®æ¸…æ´—"
    if ! clean_data "$input_file" "$temp_file"; then
        echo "âŒ æ•°æ®æ¸…æ´—å¤±è´¥"
        rm -f "$temp_file"
        return 1
    fi
    
    # é˜¶æ®µ2ï¼šæ•°æ®è½¬æ¢  
    echo "ğŸ“‹ é˜¶æ®µ2ï¼šæ•°æ®è½¬æ¢"
    if ! transform_data "$temp_file" "$output_file"; then
        echo "âŒ æ•°æ®è½¬æ¢å¤±è´¥"
        rm -f "$temp_file"
        return 1
    fi
    
    # é˜¶æ®µ3ï¼šç»“æœéªŒè¯
    echo "ğŸ“‹ é˜¶æ®µ3ï¼šç»“æœéªŒè¯"
    if ! validate_final_result "$input_file" "$output_file"; then
        echo "âŒ ç»“æœéªŒè¯å¤±è´¥"
        return 1
    fi
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f "$temp_file"
    
    echo "âœ… ç»¼åˆå¤„ç†å®Œæˆ"
    return 0
}

clean_data() {
    local input=$1
    local output=$2
    
    # ç§»é™¤ç©ºè¡Œå’Œæ³¨é‡Šè¡Œ
    grep -v '^$\|^#' "$input" > "$output"
    
    # æ£€æŸ¥æ¸…æ´—ç»“æœ
    if [ ! -s "$output" ]; then
        echo "âŒ æ•°æ®æ¸…æ´—åæ–‡ä»¶ä¸ºç©º"
        return 1
    fi
    
    local cleaned_lines=$(wc -l < "$output")
    echo "   æ¸…æ´—åå‰©ä½™ $cleaned_lines è¡Œ"
    return 0
}

transform_data() {
    local input=$1
    local output=$2
    
    # æ•°æ®è½¬æ¢å¤„ç†
    awk -F',' '
        BEGIN { print "ID,Name,Score,Grade" }
        {
            # è®¡ç®—ç­‰çº§
            if ($3 >= 90) grade = "A"
            else if ($3 >= 80) grade = "B"  
            else if ($3 >= 70) grade = "C"
            else grade = "D"
            
            print $1, $2, $3, grade
        }
    ' OFS=',' "$input" > "$output"
    
    # æ£€æŸ¥è½¬æ¢ç»“æœ
    if [ ! -s "$output" ]; then
        echo "âŒ æ•°æ®è½¬æ¢åæ–‡ä»¶ä¸ºç©º"
        return 1
    fi
    
    return 0
}

validate_final_result() {
    local original=$1
    local processed=$2
    
    # éªŒè¯å¤„ç†ç»“æœ
    local original_lines=$(tail -n +1 "$original" | wc -l)
    local processed_lines=$(tail -n +2 "$processed" | wc -l)  # æ’é™¤æ ‡é¢˜è¡Œ
    
    echo "   åŸå§‹æ•°æ®ï¼š$original_lines è¡Œ"
    echo "   å¤„ç†ç»“æœï¼š$processed_lines è¡Œ"
    
    # æ£€æŸ¥æ•°æ®é‡æ˜¯å¦åˆç†
    if [ "$processed_lines" -eq 0 ]; then
        echo "âŒ å¤„ç†åæ— æ•°æ®"
        return 1
    fi
    
    # éªŒè¯CSVæ ¼å¼
    if ! validate_csv_output "$processed" 4; then
        return 1
    fi
    
    return 0
}
```

---

## 5. ğŸ› è„šæœ¬è°ƒè¯•ä¸æ—¥å¿—è®°å½•


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦è°ƒè¯•å’Œæ—¥å¿—


**è°ƒè¯•çš„é‡è¦æ€§**ï¼š
- **å®šä½é—®é¢˜**ï¼šå¿«é€Ÿæ‰¾åˆ°è„šæœ¬å‡ºé”™çš„ä½ç½®
- **ç†è§£æµç¨‹**ï¼šäº†è§£è„šæœ¬æ‰§è¡Œçš„è¯¦ç»†è¿‡ç¨‹
- **æ€§èƒ½åˆ†æ**ï¼šå‘ç°æ€§èƒ½ç“¶é¢ˆ

**æ—¥å¿—çš„ä½œç”¨**ï¼š
- **è®°å½•æ‰§è¡Œå†å²**ï¼šä¿ç•™è„šæœ¬è¿è¡Œè®°å½•
- **ç›‘æ§çŠ¶æ€**ï¼šäº†è§£è„šæœ¬è¿è¡Œæƒ…å†µ
- **é—®é¢˜è¿½è¸ª**ï¼šå‡ºç°é—®é¢˜æ—¶å¯ä»¥å›æº¯

### 5.2 Shellè„šæœ¬è°ƒè¯•æŠ€å·§


**ğŸ”¸ å¯ç”¨è°ƒè¯•æ¨¡å¼**

| è°ƒè¯•é€‰é¡¹ | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|----------|------|----------|
| `bash -x script.sh` | æ˜¾ç¤ºæ¯è¡Œæ‰§è¡Œçš„å‘½ä»¤ | æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ |
| `bash -v script.sh` | æ˜¾ç¤ºè¯»å–çš„æ¯ä¸€è¡Œ | æŸ¥çœ‹è„šæœ¬è§£æè¿‡ç¨‹ |
| `set -x` | åœ¨è„šæœ¬ä¸­å¯ç”¨è°ƒè¯• | è°ƒè¯•ç‰¹å®šéƒ¨åˆ† |
| `set +x` | å…³é—­è°ƒè¯•æ¨¡å¼ | åœæ­¢è¯¦ç»†è¾“å‡º |

```bash
#!/bin/bash

# è°ƒè¯•ç‰¹å®šå‡½æ•°
debug_function() {
    echo "è¿›å…¥è°ƒè¯•å‡½æ•°"
    
    set -x  # å¼€å¯è°ƒè¯•
    
    local file=$1
    count=$(wc -l < "$file")
    echo "æ–‡ä»¶è¡Œæ•°: $count"
    
    set +x  # å…³é—­è°ƒè¯•
    
    echo "è°ƒè¯•å‡½æ•°ç»“æŸ"
}
```

**ğŸ”¸ ä½¿ç”¨è°ƒè¯•å˜é‡**
```bash
#!/bin/bash

# å®šä¹‰è°ƒè¯•çº§åˆ«
DEBUG_LEVEL=${DEBUG_LEVEL:-0}

debug_print() {
    local level=$1
    shift
    
    if [ "$DEBUG_LEVEL" -ge "$level" ]; then
        echo "[è°ƒè¯•$level] $*" >&2
    fi
}

process_file() {
    local file=$1
    
    debug_print 1 "å¼€å§‹å¤„ç†æ–‡ä»¶: $file"
    debug_print 2 "æ–‡ä»¶å¤§å°: $(stat -c%s "$file") å­—èŠ‚"
    
    # å®é™…å¤„ç†
    result=$(wc -l < "$file")
    
    debug_print 1 "å¤„ç†å®Œæˆï¼Œç»“æœ: $result"
    echo "$result"
}

# ä½¿ç”¨æ–¹æ³•ï¼š
# DEBUG_LEVEL=0 ./script.sh  # æ— è°ƒè¯•è¾“å‡º
# DEBUG_LEVEL=1 ./script.sh  # åŸºæœ¬è°ƒè¯•ä¿¡æ¯
# DEBUG_LEVEL=2 ./script.sh  # è¯¦ç»†è°ƒè¯•ä¿¡æ¯
```

### 5.3 æ—¥å¿—è®°å½•ç³»ç»Ÿ


**ğŸ”¸ åŸºç¡€æ—¥å¿—å‡½æ•°**
```bash
#!/bin/bash

# æ—¥å¿—é…ç½®
LOG_FILE="/var/log/data_processing.log"
LOG_LEVEL=${LOG_LEVEL:-"INFO"}

# æ—¥å¿—çº§åˆ«å®šä¹‰
declare -A LOG_LEVELS=( 
    ["ERROR"]=0 
    ["WARN"]=1 
    ["INFO"]=2 
    ["DEBUG"]=3 
)

# å†™å…¥æ—¥å¿—
log_message() {
    local level=$1
    shift
    local message="$*"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # æ£€æŸ¥æ—¥å¿—çº§åˆ«
    if [ ${LOG_LEVELS[$level]} -le ${LOG_LEVELS[$LOG_LEVEL]} ]; then
        # å†™å…¥æ—¥å¿—æ–‡ä»¶
        echo "[$timestamp] [$level] $message" >> "$LOG_FILE"
        
        # æ ¹æ®çº§åˆ«è¾“å‡ºåˆ°ä¸åŒæµ
        case "$level" in
            "ERROR"|"WARN")
                echo "[$level] $message" >&2  # é”™è¯¯è¾“å‡ºåˆ°stderr
                ;;
            "INFO"|"DEBUG")
                echo "[$level] $message"       # ä¿¡æ¯è¾“å‡ºåˆ°stdout
                ;;
        esac
    fi
}

# ä¾¿æ·å‡½æ•°
log_error() { log_message "ERROR" "$@"; }
log_warn()  { log_message "WARN" "$@"; }
log_info()  { log_message "INFO" "$@"; }
log_debug() { log_message "DEBUG" "$@"; }
```

**ğŸ”¸ å¸¦æœ‰æ—¥å¿—çš„å¤„ç†å‡½æ•°**
```bash
process_data_with_logging() {
    local input_file=$1
    local output_file=$2
    
    log_info "å¼€å§‹å¤„ç†æ•°æ®æ–‡ä»¶: $input_file"
    log_debug "è¾“å‡ºå°†ä¿å­˜åˆ°: $output_file"
    
    # æ£€æŸ¥è¾“å…¥æ–‡ä»¶
    if [ ! -f "$input_file" ]; then
        log_error "è¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨: $input_file"
        return 1
    fi
    
    local file_size=$(stat -c%s "$input_file")
    log_debug "è¾“å…¥æ–‡ä»¶å¤§å°: $file_size å­—èŠ‚"
    
    # å¼€å§‹å¤„ç†
    local start_time=$(date +%s)
    log_info "å¼€å§‹æ•°æ®å¤„ç†"
    
    # å®é™…å¤„ç†é€»è¾‘
    if awk -F',' '{
        # ç»Ÿè®¡å¤„ç†
        if (NR > 1) {  # è·³è¿‡æ ‡é¢˜è¡Œ
            sum += $3
            count++
        }
    } END {
        print "æ€»è®¡:", sum, "å¹³å‡:", (count > 0 ? sum/count : 0)
    }' "$input_file" > "$output_file"; then
        
        local end_time=$(date +%s)
        local duration=$((end_time - start_time))
        local output_size=$(stat -c%s "$output_file")
        
        log_info "æ•°æ®å¤„ç†å®Œæˆ"
        log_info "å¤„ç†è€—æ—¶: ${duration}ç§’"
        log_info "è¾“å‡ºæ–‡ä»¶å¤§å°: $output_size å­—èŠ‚"
        
        return 0
    else
        log_error "æ•°æ®å¤„ç†å¤±è´¥"
        return 1
    fi
}
```

### 5.4 é«˜çº§è°ƒè¯•æŠ€æœ¯


**ğŸ”¸ æ€§èƒ½åˆ†æ**
```bash
# å¸¦æ€§èƒ½ç›‘æ§çš„å‡½æ•°
profile_function() {
    local func_name=$1
    shift
    
    echo "ğŸ” æ€§èƒ½åˆ†æ: $func_name"
    
    # è®°å½•å¼€å§‹æ—¶é—´å’Œèµ„æºä½¿ç”¨
    local start_time=$(date +%s.%N)
    local start_memory=$(ps -o rss= -p $$)
    
    # æ‰§è¡Œå‡½æ•°
    "$func_name" "$@"
    local exit_code=$?
    
    # è®°å½•ç»“æŸæ—¶é—´å’Œèµ„æºä½¿ç”¨
    local end_time=$(date +%s.%N)
    local end_memory=$(ps -o rss= -p $$)
    
    # è®¡ç®—æ€§èƒ½æŒ‡æ ‡
    local duration=$(echo "$end_time - $start_time" | bc)
    local memory_diff=$((end_memory - start_memory))
    
    echo "ğŸ“Š æ€§èƒ½æŠ¥å‘Š:"
    echo "   æ‰§è¡Œæ—¶é—´: ${duration}ç§’"
    echo "   å†…å­˜å˜åŒ–: ${memory_diff}KB"
    echo "   é€€å‡ºç : $exit_code"
    
    return $exit_code
}

# ä½¿ç”¨ç¤ºä¾‹
profile_function process_large_file "/path/to/large/data.txt"
```

**ğŸ”¸ é”™è¯¯è¿½è¸ª**
```bash
# é”™è¯¯è¿½è¸ªå‡½æ•°
trace_error() {
    local line_no=$1
    local command=$2
    local exit_code=$3
    
    log_error "è„šæœ¬æ‰§è¡Œå¤±è´¥"
    log_error "ä½ç½®: ç¬¬ $line_no è¡Œ"
    log_error "å‘½ä»¤: $command"
    log_error "é”™è¯¯ç : $exit_code"
    
    # æ˜¾ç¤ºç›¸å…³ä»£ç ä¸Šä¸‹æ–‡
    if [ -f "$0" ]; then
        log_error "ä»£ç ä¸Šä¸‹æ–‡:"
        sed -n "$((line_no-2)),$((line_no+2))p" "$0" | \
        awk -v target="$line_no" '{
            prefix = (NR == target-2+1) ? ">>> " : "    "
            print prefix NR+line_no-3 ": " $0
        }' line_no="$line_no" >&2
    fi
}

# è®¾ç½®é”™è¯¯è¿½è¸ª
trap 'trace_error $LINENO "$BASH_COMMAND" $?' ERR
```

---

## 6. ğŸ”§ å¯é‡ç”¨å‡½æ•°å°è£…


### 6.1 ä¸ºä»€ä¹ˆè¦å°è£…å‡½æ•°


**å‡½æ•°çš„å¥½å¤„**ï¼š
- **ä»£ç å¤ç”¨**ï¼šé¿å…é‡å¤ç¼–å†™ç›¸åŒé€»è¾‘
- **æ¨¡å—åŒ–**ï¼šå°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºç®€å•åŠŸèƒ½
- **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹åŠŸèƒ½åªéœ€æ”¹åŠ¨ä¸€å¤„
- **æé«˜å¯è¯»æ€§**ï¼šå‡½æ•°åèƒ½æ¸…æ™°è¡¨è¾¾åŠŸèƒ½

### 6.2 æ–‡æœ¬å¤„ç†å¸¸ç”¨å‡½æ•°åº“


**ğŸ”¸ æ–‡ä»¶æ“ä½œå‡½æ•°**
```bash
# æ–‡ä»¶æ“ä½œå·¥å…·åº“

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯è¯»
is_readable_file() {
    local file=$1
    [ -f "$file" ] && [ -r "$file" ]
}

# æ£€æŸ¥ç›®å½•æ˜¯å¦å¯å†™
is_writable_dir() {
    local dir=$1
    [ -d "$dir" ] && [ -w "$dir" ]
}

# å®‰å…¨åˆ›å»ºä¸´æ—¶æ–‡ä»¶
create_temp_file() {
    local prefix=${1:-"script"}
    mktemp "/tmp/${prefix}_XXXXXX"
}

# å®‰å…¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶
cleanup_temp_files() {
    local temp_pattern=$1
    if [ -n "$temp_pattern" ]; then
        rm -f /tmp/"$temp_pattern"_* 2>/dev/null || true
    fi
}

# å¤‡ä»½æ–‡ä»¶
backup_file() {
    local file=$1
    local backup_dir=${2:-"/backup"}
    local timestamp=$(date '+%Y%m%d_%H%M%S')
    
    if [ -f "$file" ]; then
        local filename=$(basename "$file")
        local backup_file="${backup_dir}/${filename}.${timestamp}.bak"
        
        mkdir -p "$backup_dir"
        cp "$file" "$backup_file"
        echo "æ–‡ä»¶å·²å¤‡ä»½åˆ°: $backup_file"
        return 0
    else
        echo "é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨: $file" >&2
        return 1
    fi
}
```

**ğŸ”¸ æ•°æ®å¤„ç†å‡½æ•°**
```bash
# æ•°æ®å¤„ç†å·¥å…·åº“

# CSVæ–‡ä»¶åˆ—æ•°æ£€æŸ¥
check_csv_columns() {
    local csv_file=$1
    local expected_cols=$2
    
    local actual_cols=$(head -1 "$csv_file" | awk -F',' '{print NF}')
    
    if [ "$actual_cols" -eq "$expected_cols" ]; then
        return 0
    else
        echo "CSVåˆ—æ•°ä¸åŒ¹é…ï¼šæœŸæœ› $expected_colsï¼Œå®é™… $actual_cols" >&2
        return 1
    fi
}

# å»é‡å¹¶è®¡æ•°
deduplicate_and_count() {
    local input_file=$1
    local output_file=$2
    local column=${3:-1}  # é»˜è®¤ç¬¬1åˆ—
    
    awk -v col="$column" '
        { count[$col]++ }
        END {
            for (item in count) {
                print item, count[item]
            }
        }
    ' "$input_file" | sort -k2 -nr > "$output_file"
}

# æ•°æ®ç»Ÿè®¡
calculate_statistics() {
    local input_file=$1
    local column=$2
    
    awk -v col="$column" '
        NR > 1 {  # è·³è¿‡æ ‡é¢˜è¡Œ
            values[NR-1] = $col
            sum += $col
            count++
            if ($col > max || max == "") max = $col
            if ($col < min || min == "") min = $col
        }
        END {
            if (count > 0) {
                avg = sum / count
                print "æ€»æ•°:", count
                print "æ±‚å’Œ:", sum  
                print "å¹³å‡å€¼:", avg
                print "æœ€å¤§å€¼:", max
                print "æœ€å°å€¼:", min
            }
        }
    ' FS=',' "$input_file"
}

# æŒ‰æ¡ä»¶è¿‡æ»¤æ•°æ®
filter_data() {
    local input_file=$1
    local output_file=$2
    local condition=$3
    
    awk -v cond="$condition" '
        BEGIN { FS = "," }
        NR == 1 { print; next }  # ä¿ç•™æ ‡é¢˜è¡Œ
        
        # åŠ¨æ€æ¡ä»¶åˆ¤æ–­ï¼ˆç®€åŒ–ç‰ˆï¼‰
        {
            if (cond == "high_score" && $3 > 80) print
            else if (cond == "low_score" && $3 < 60) print  
            else if (cond == "medium_score" && $3 >= 60 && $3 <= 80) print
        }
    ' "$input_file" > "$output_file"
}
```

### 6.3 é€šç”¨å·¥å…·å‡½æ•°


**ğŸ”¸ å­—ç¬¦ä¸²å¤„ç†å‡½æ•°**
```bash
# å­—ç¬¦ä¸²å·¥å…·åº“

# å»é™¤å­—ç¬¦ä¸²é¦–å°¾ç©ºç™½
trim_string() {
    local str="$1"
    # å»é™¤å¼€å¤´ç©ºç™½
    str="${str#"${str%%[![:space:]]*}"}"
    # å»é™¤ç»“å°¾ç©ºç™½  
    str="${str%"${str##*[![:space:]]}"}"
    echo "$str"
}

# æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ•°å­—
is_number() {
    local str="$1"
    [[ "$str" =~ ^[+-]?[0-9]+([.][0-9]+)?$ ]]
}

# ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
generate_random_string() {
    local length=${1:-8}
    tr -dc 'a-zA-Z0-9' < /dev/urandom | head -c "$length"
}

# å­—ç¬¦ä¸²æ›¿æ¢
replace_string() {
    local text="$1"
    local old="$2"  
    local new="$3"
    echo "${text//$old/$new}"
}
```

**ğŸ”¸ æ—¶é—´å¤„ç†å‡½æ•°**
```bash
# æ—¶é—´å·¥å…·åº“

# æ ¼å¼åŒ–å½“å‰æ—¶é—´
current_timestamp() {
    local format=${1:-"%Y-%m-%d %H:%M:%S"}
    date +"$format"
}

# è®¡ç®—æ—¶é—´å·®ï¼ˆç§’ï¼‰
time_diff() {
    local start_time=$1
    local end_time=$2
    echo $((end_time - start_time))
}

# äººæ€§åŒ–æ—¶é—´æ˜¾ç¤º
human_readable_time() {
    local seconds=$1
    
    if [ "$seconds" -lt 60 ]; then
        echo "${seconds}ç§’"
    elif [ "$seconds" -lt 3600 ]; then
        echo "$((seconds/60))åˆ†$((seconds%60))ç§’"
    else
        echo "$((seconds/3600))å°æ—¶$(((seconds%3600)/60))åˆ†$((seconds%60))ç§’"
    fi
}
```

### 6.4 å‡½æ•°åº“çš„ä½¿ç”¨ç¤ºä¾‹


**ğŸ”¸ åˆ›å»ºå¯é‡ç”¨çš„å‡½æ•°åº“æ–‡ä»¶**
```bash
# æ–‡ä»¶: data_processing_lib.sh
#!/bin/bash

# å¯¼å…¥å…¶ä»–åº“æ–‡ä»¶
source "$(dirname "${BASH_SOURCE[0]}")/file_utils.sh"
source "$(dirname "${BASH_SOURCE[0]}")/string_utils.sh"

# ç»¼åˆæ•°æ®å¤„ç†å‡½æ•°
process_csv_report() {
    local input_csv=$1
    local output_dir=$2
    local report_name=${3:-"report"}
    
    # å‚æ•°éªŒè¯
    if ! is_readable_file "$input_csv"; then
        log_error "æ— æ³•è¯»å–è¾“å…¥æ–‡ä»¶: $input_csv"
        return 1
    fi
    
    if ! is_writable_dir "$output_dir"; then
        log_error "è¾“å‡ºç›®å½•ä¸å¯å†™: $output_dir"
        return 1
    fi
    
    # åˆ›å»ºä¸´æ—¶æ–‡ä»¶
    local temp_file=$(create_temp_file "csv_process")
    local timestamp=$(current_timestamp "%Y%m%d_%H%M%S")
    
    log_info "å¼€å§‹å¤„ç†CSVæŠ¥è¡¨: $input_csv"
    
    # æ•°æ®å¤„ç†æµç¨‹
    {
        echo "=== CSVæ•°æ®æŠ¥è¡¨ - $(current_timestamp) ==="
        echo ""
        
        echo "ğŸ“Š åŸºæœ¬ä¿¡æ¯:"
        echo "æ–‡ä»¶: $(basename "$input_csv")"
        echo "å¤§å°: $(stat -c%s "$input_csv") å­—èŠ‚"
        echo "è¡Œæ•°: $(wc -l < "$input_csv")"
        echo ""
        
        echo "ğŸ“ˆ æ•°æ®ç»Ÿè®¡:"
        calculate_statistics "$input_csv" 3  # å‡è®¾ç¬¬3åˆ—æ˜¯æ•°å€¼åˆ—
        echo ""
        
        echo "ğŸ” æ•°æ®åˆ†æ:"
        deduplicate_and_count "$input_csv" "$temp_file" 2  # æŒ‰ç¬¬2åˆ—å»é‡è®¡æ•°
        echo "é‡å¤æ•°æ®ç»Ÿè®¡:"
        head -10 "$temp_file"
        
    } > "${output_dir}/${report_name}_${timestamp}.txt"
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f "$temp_file"
    
    log_info "æŠ¥è¡¨ç”Ÿæˆå®Œæˆ: ${output_dir}/${report_name}_${timestamp}.txt"
    return 0
}
```

**ğŸ”¸ åœ¨ä¸»è„šæœ¬ä¸­ä½¿ç”¨å‡½æ•°åº“**
```bash
#!/bin/bash
# ä¸»å¤„ç†è„šæœ¬

# åŠ è½½å‡½æ•°åº“
SCRIPT_DIR="$(dirname "${BASH_SOURCE[0]}")"
source "$SCRIPT_DIR/data_processing_lib.sh"

# ä¸»å‡½æ•°
main() {
    local input_file=$1
    local output_dir=${2:-"./output"}
    
    echo "ğŸš€ å¼€å§‹æ•°æ®å¤„ç†ä»»åŠ¡"
    
    # åˆ›å»ºè¾“å‡ºç›®å½•
    mkdir -p "$output_dir"
    
    # å¤„ç†æ•°æ®
    if process_csv_report "$input_file" "$output_dir" "sales_report"; then
        echo "âœ… å¤„ç†å®Œæˆ"
    else
        echo "âŒ å¤„ç†å¤±è´¥"
        exit 1
    fi
}

# è¿è¡Œä¸»å‡½æ•°
main "$@"
```

---

## 7. ğŸ“ˆ è„šæœ¬æ€§èƒ½ç›‘æ§


### 7.1 ä¸ºä»€ä¹ˆè¦ç›‘æ§æ€§èƒ½


**æ€§èƒ½é—®é¢˜çš„å½±å“**ï¼š
- **æ‰§è¡Œæ—¶é—´é•¿**ï¼šå½±å“å·¥ä½œæ•ˆç‡
- **èµ„æºæ¶ˆè€—å¤§**ï¼šå¯èƒ½å½±å“ç³»ç»Ÿå…¶ä»–ç¨‹åº
- **å†…å­˜æ³„æ¼**ï¼šé•¿æœŸè¿è¡Œå¯èƒ½è€—å°½ç³»ç»Ÿèµ„æº

**ç›‘æ§çš„å¥½å¤„**ï¼š
- **åŠæ—¶å‘ç°é—®é¢˜**ï¼šåœ¨é—®é¢˜ä¸¥é‡å‰å‘ç°
- **ä¼˜åŒ–ä¾æ®**ï¼šä¸ºæ€§èƒ½ä¼˜åŒ–æä¾›æ•°æ®æ”¯æŒ
- **å®¹é‡è§„åˆ’**ï¼šäº†è§£èµ„æºéœ€æ±‚

### 7.2 åŸºç¡€æ€§èƒ½ç›‘æ§


**ğŸ”¸ æ‰§è¡Œæ—¶é—´ç›‘æ§**
```bash
# ç®€å•çš„æ‰§è¡Œæ—¶é—´æµ‹é‡
time_execution() {
    local func_name=$1
    shift
    
    echo "â±ï¸  å¼€å§‹æ‰§è¡Œ: $func_name"
    local start_time=$(date +%s.%N)
    
    # æ‰§è¡Œå‡½æ•°
    "$func_name" "$@"
    local exit_code=$?
    
    local end_time=$(date +%s.%N)
    local duration=$(echo "$end_time - $start_time" | bc 2>/dev/null || echo "è®¡ç®—å¤±è´¥")
    
    printf "â° æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: %.2fç§’\n" "$duration"
    return $exit_code
}

# ä½¿ç”¨ç¤ºä¾‹
time_execution process_large_file "/path/to/data.txt"
```

**ğŸ”¸ èµ„æºä½¿ç”¨ç›‘æ§**
```bash
# èµ„æºä½¿ç”¨ç›‘æ§å‡½æ•°
monitor_resources() {
    local func_name=$1
    shift
    local monitor_interval=${MONITOR_INTERVAL:-5}  # 5ç§’é—´éš”
    
    echo "ğŸ“Š å¼€å§‹èµ„æºç›‘æ§: $func_name"
    
    # è®°å½•åˆå§‹çŠ¶æ€
    local pid=$$
    local start_time=$(date +%s)
    local start_memory=$(ps -o rss= -p $pid 2>/dev/null | tr -d ' ')
    local start_cpu=$(ps -o %cpu= -p $pid 2>/dev/null | tr -d ' ')
    
    # åˆ›å»ºç›‘æ§æ–‡ä»¶
    local monitor_file="/tmp/monitor_${func_name}_$$.log"
    echo "æ—¶é—´,å†…å­˜(KB),CPU(%)" > "$monitor_file"
    
    # åå°ç›‘æ§è¿›ç¨‹
    (
        while kill -0 $pid 2>/dev/null; do
            local current_time=$(date +%s)
            local elapsed=$((current_time - start_time))
            local memory=$(ps -o rss= -p $pid 2>/dev/null | tr -d ' ')
            local cpu=$(ps -o %cpu= -p $pid 2>/dev/null | tr -d ' ')
            
            echo "$elapsed,${memory:-0},${cpu:-0}" >> "$monitor_file"
            sleep "$monitor_interval"
        done
    ) &
    local monitor_pid=$!
    
    # æ‰§è¡Œç›®æ ‡å‡½æ•°
    "$func_name" "$@"
    local exit_code=$?
    
    # åœæ­¢ç›‘æ§
    kill $monitor_pid 2>/dev/null || true
    wait $monitor_pid 2>/dev/null || true
    
    # ç”Ÿæˆç›‘æ§æŠ¥å‘Š
    generate_performance_report "$monitor_file" "$func_name"
    
    return $exit_code
}

generate_performance_report() {
    local monitor_file=$1
    local func_name=$2
    
    if [ ! -f "$monitor_file" ]; then
        echo "âš ï¸  ç›‘æ§æ–‡ä»¶ä¸å­˜åœ¨"
        return 1
    fi
    
    echo ""
    echo "ğŸ“ˆ æ€§èƒ½ç›‘æ§æŠ¥å‘Š: $func_name"
    echo "=================================="
    
    # è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
    awk -F',' '
        NR > 1 {  # è·³è¿‡æ ‡é¢˜è¡Œ
            time[NR-1] = $1
            memory[NR-1] = $2  
            cpu[NR-1] = $3
            
            total_memory += $2
            total_cpu += $3
            count++
            
            if ($2 > max_memory) max_memory = $2
            if ($3 > max_cpu) max_cpu = $3
        }
        END {
            if (count > 0) {
                avg_memory = total_memory / count
                avg_cpu = total_cpu / count
                duration = time[count-1]
                
                print "æ‰§è¡Œæ—¶é•¿:", duration "ç§’"
                print "å¹³å‡å†…å­˜:", int(avg_memory) "KB"
                print "å³°å€¼å†…å­˜:", int(max_memory) "KB"  
                print "å¹³å‡CPU:", avg_cpu "%"
                print "å³°å€¼CPU:", max_cpu "%"
            }
        }
    ' "$monitor_file"
    
    # æ¸…ç†ç›‘æ§æ–‡ä»¶
    rm -f "$monitor_file"
}
```

### 7.3 é«˜çº§æ€§èƒ½åˆ†æ


**ğŸ”¸ å¤„ç†é€Ÿåº¦åˆ†æ**
```bash
# å¤„ç†é€Ÿåº¦åˆ†æ
analyze_processing_speed() {
    local input_file=$1
    local processing_func=$2
    
    if [ ! -f "$input_file" ]; then
        echo "âŒ è¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨"
        return 1
    fi
    
    # è·å–æ–‡ä»¶ä¿¡æ¯
    local file_size=$(stat -c%s "$input_file")
    local line_count=$(wc -l < "$input_file")
    
    echo "ğŸ“‹ æ–‡ä»¶ä¿¡æ¯:"
    echo "   æ–‡ä»¶å¤§å°: $(numfmt --to=iec-i --suffix=B $file_size)"
    echo "   è¡Œæ•°: $line_count"
    
    # æ‰§è¡Œå¤„ç†å¹¶æµ‹é‡æ—¶é—´
    echo ""
    echo "ğŸ”„ å¼€å§‹å¤„ç†..."
    local start_time=$(date +%s.%N)
    
    "$processing_func" "$input_file"
    local exit_code=$?
    
    local end_time=$(date +%s.%N)
    local duration=$(echo "$end_time - $start_time" | bc)
    
    if [ $exit_code -eq 0 ]; then
        # è®¡ç®—å¤„ç†é€Ÿåº¦
        local bytes_per_sec=$(echo "scale=2; $file_size / $duration" | bc)
        local lines_per_sec=$(echo "scale=2; $line_count / $duration" | bc)
        
        echo ""
        echo "ğŸ“Š å¤„ç†é€Ÿåº¦åˆ†æ:"
        printf "   å¤„ç†æ—¶é—´: %.2fç§’\n" "$duration"
        printf "   å¤„ç†é€Ÿåº¦: %s/ç§’\n" "$(numfmt --to=iec-i --suffix=B $bytes_per_sec | cut -d. -f1)"
        printf "   è¡Œå¤„ç†é€Ÿåº¦: %.0fè¡Œ/ç§’\n" "$lines_per_sec"
    else
        echo "âŒ å¤„ç†å¤±è´¥"
    fi
    
    return $exit_code
}
```

**ğŸ”¸ å†…å­˜ä½¿ç”¨åˆ†æ**
```bash
# å†…å­˜ä½¿ç”¨åˆ†æ
analyze_memory_usage() {
    local func_name=$1
    shift
    
    echo "ğŸ§  å†…å­˜ä½¿ç”¨åˆ†æ: $func_name"
    
    # è®°å½•åˆå§‹å†…å­˜
    local initial_memory=$(free -m | awk 'NR==2{print $3}')
    local process_memory_before=$(ps -o rss= -p $$ | tr -d ' ')
    
    echo "ğŸ“‹ æ‰§è¡Œå‰çŠ¶æ€:"
    echo "   ç³»ç»Ÿå·²ç”¨å†…å­˜: ${initial_memory}MB"
    echo "   è¿›ç¨‹å†…å­˜: ${process_memory_before}KB"
    
    # æ‰§è¡Œå‡½æ•°
    "$func_name" "$@"
    local exit_code=$?
    
    # è®°å½•æ‰§è¡Œåå†…å­˜
    local final_memory=$(free -m | awk 'NR==2{print $3}')
    local process_memory_after=$(ps -o rss= -p $$ | tr -d ' ')
    
    # è®¡ç®—å†…å­˜å˜åŒ–
    local system_memory_diff=$((final_memory - initial_memory))
    local process_memory_diff=$((process_memory_after - process_memory_before))
    
    echo ""
    echo "ğŸ“‹ æ‰§è¡ŒåçŠ¶æ€:"
    echo "   ç³»ç»Ÿå·²ç”¨å†…å­˜: ${final_memory}MB"
    echo "   è¿›ç¨‹å†…å­˜: ${process_memory_after}KB"
    echo ""
    echo "ğŸ“ˆ å†…å­˜å˜åŒ–:"
    echo "   ç³»ç»Ÿå†…å­˜å˜åŒ–: ${system_memory_diff}MB"
    echo "   è¿›ç¨‹å†…å­˜å˜åŒ–: ${process_memory_diff}KB"
    
    # å†…å­˜ä½¿ç”¨è¯„ä¼°
    if [ "$process_memory_diff" -gt 10240 ]; then  # 10MB
        echo "âš ï¸  è­¦å‘Šï¼šè¿›ç¨‹å†…å­˜ä½¿ç”¨å¢åŠ è¾ƒå¤šï¼Œå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼"
    elif [ "$process_memory_diff" -gt 0 ]; then
        echo "âœ… å†…å­˜ä½¿ç”¨æ­£å¸¸"
    else
        echo "âœ… å†…å­˜ä½¿ç”¨ä¼˜ç§€ï¼Œç”šè‡³æœ‰æ‰€å‡å°‘"
    fi
    
    return $exit_code
}
```

### 7.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ”¸ æ€§èƒ½ç“¶é¢ˆæ£€æµ‹**
```bash
# æ€§èƒ½ç“¶é¢ˆæ£€æµ‹
detect_performance_bottlenecks() {
    local script_file=$1
    
    echo "ğŸ” æ€§èƒ½ç“¶é¢ˆæ£€æµ‹"
    echo "===================="
    
    # æ£€æµ‹æ½œåœ¨çš„æ€§èƒ½é—®é¢˜
    
    # 1. æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„å¤–éƒ¨å‘½ä»¤è°ƒç”¨
    echo "ğŸ“‹ æ£€æŸ¥å¤–éƒ¨å‘½ä»¤ä½¿ç”¨:"
    local external_commands=$(grep -E "(grep|sed|awk|sort|uniq|wc)" "$script_file" | wc -l)
    echo "   å¤–éƒ¨å‘½ä»¤è°ƒç”¨æ¬¡æ•°: $external_commands"
    
    if [ "$external_commands" -gt 20 ]; then
        echo "âš ï¸  å»ºè®®ï¼šè¿‡å¤šå¤–éƒ¨å‘½ä»¤è°ƒç”¨ï¼Œè€ƒè™‘åˆå¹¶æˆ–ä½¿ç”¨å†…ç½®åŠŸèƒ½"
    fi
    
    # 2. æ£€æŸ¥å¾ªç¯ä¸­çš„æ€§èƒ½é—®é¢˜
    echo ""
    echo "ğŸ“‹ æ£€æŸ¥å¾ªç¯ç»“æ„:"
    local loop_count=$(grep -E "(for|while|until)" "$script_file" | wc -l)
    echo "   å¾ªç¯ç»“æ„æ•°é‡: $loop_count"
    
    # æ£€æŸ¥å¾ªç¯ä¸­çš„ç®¡é“ä½¿ç”¨
    local pipes_in_loops=$(grep -A5 -E "(for|while|until)" "$script_file" | grep -c "|" || true)
    if [ "$pipes_in_loops" -gt 0 ]; then
        echo "âš ï¸  å»ºè®®ï¼šå¾ªç¯ä¸­å‘ç°ç®¡é“æ“ä½œï¼Œå¯èƒ½å½±å“æ€§èƒ½"
    fi
    
    # 3. æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶ä½¿ç”¨
    echo ""
    echo "ğŸ“‹ æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶ä½¿ç”¨:"
    local temp_files=$(grep -E "(/tmp/|mktemp)" "$script_file" | wc -l)
    echo "   ä¸´æ—¶æ–‡ä»¶æ“ä½œ: $temp_files"
    
    if [ "$temp_files" -gt 5 ]; then
        echo "âš ï¸  å»ºè®®ï¼šä¸´æ—¶æ–‡ä»¶ä½¿ç”¨è¾ƒå¤šï¼Œæ³¨æ„æ¸…ç†å’Œä¼˜åŒ–"
    fi
}
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®æ€»ç»“**ï¼š

| æ€§èƒ½é—®é¢˜ | ä¼˜åŒ–æ–¹æ³• | ç¤ºä¾‹ |
|----------|----------|------|
| **å¤šæ¬¡æ–‡ä»¶è¯»å–** | ä¸€æ¬¡è¯»å–ï¼Œå†…å­˜å¤„ç† | `mapfile -t lines < file` |
| **é¢‘ç¹ç®¡é“è°ƒç”¨** | åˆå¹¶åˆ°å•ä¸ªawkå‘½ä»¤ | `awk '{...}' file` ä»£æ›¿å¤šä¸ªå‘½ä»¤ |
| **ä¸å¿…è¦çš„å¤–éƒ¨å‘½ä»¤** | ä½¿ç”¨Shellå†…ç½®åŠŸèƒ½ | `${#var}` ä»£æ›¿ `echo $var \| wc -c` |
| **å¤§æ–‡ä»¶å…¨é‡å¤„ç†** | åˆ†å—å¤„ç†æˆ–æµå¤„ç† | `split` + å¹¶è¡Œå¤„ç† |
| **é€’å½’ç›®å½•éå†** | ä½¿ç”¨ `find` ä»£æ›¿é€’å½’è„šæœ¬ | `find dir -type f -exec {} \;` |

---

## 8. ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ³¨æ„äº‹é¡¹


### 8.1 ç”Ÿäº§ç¯å¢ƒçš„ç‰¹ç‚¹å’Œè¦æ±‚


**ç”Ÿäº§ç¯å¢ƒç‰¹ç‚¹**ï¼š
- **ç¨³å®šæ€§è¦æ±‚é«˜**ï¼šä¸èƒ½å‡ºç°æ„å¤–ä¸­æ–­
- **æ•°æ®é‡è¦æ€§**ï¼šå¤„ç†çš„éƒ½æ˜¯é‡è¦ä¸šåŠ¡æ•°æ®
- **å¤šç”¨æˆ·ç¯å¢ƒ**ï¼šå¯èƒ½åŒæ—¶æœ‰å¤šä¸ªç”¨æˆ·å’Œè¿›ç¨‹
- **èµ„æºå—é™**ï¼šéœ€è¦è€ƒè™‘ç³»ç»Ÿèµ„æºé™åˆ¶

**éƒ¨ç½²è¦æ±‚**ï¼š
- **å¯é æ€§**ï¼šè„šæœ¬å¿…é¡»ç¨³å®šå¯é 
- **å¯ç›‘æ§æ€§**ï¼šèƒ½å¤Ÿç›‘æ§æ‰§è¡ŒçŠ¶æ€
- **å¯æ¢å¤æ€§**ï¼šå‡ºç°é—®é¢˜èƒ½å¤Ÿå¿«é€Ÿæ¢å¤
- **å®‰å…¨æ€§**ï¼šä¿æŠ¤æ•°æ®å’Œç³»ç»Ÿå®‰å…¨

### 8.2 è„šæœ¬éƒ¨ç½²å‰æ£€æŸ¥


**ğŸ”¸ ä»£ç è´¨é‡æ£€æŸ¥æ¸…å•**
```bash
# éƒ¨ç½²å‰æ£€æŸ¥è„šæœ¬
deployment_check() {
    local script_file=$1
    local check_passed=true
    
    echo "ğŸ” éƒ¨ç½²å‰æ£€æŸ¥: $(basename "$script_file")"
    echo "=================================="
    
    # 1. åŸºæœ¬æ–‡ä»¶æ£€æŸ¥
    echo "ğŸ“‹ åŸºæœ¬æ–‡ä»¶æ£€æŸ¥:"
    if [ ! -f "$script_file" ]; then
        echo "âŒ è„šæœ¬æ–‡ä»¶ä¸å­˜åœ¨"
        check_passed=false
    else
        echo "âœ… è„šæœ¬æ–‡ä»¶å­˜åœ¨"
    fi
    
    if [ ! -x "$script_file" ]; then
        echo "âŒ è„šæœ¬æ–‡ä»¶ä¸å¯æ‰§è¡Œ"
        check_passed=false
    else
        echo "âœ… è„šæœ¬æ–‡ä»¶å¯æ‰§è¡Œ"
    fi
    
    # 2. è¯­æ³•æ£€æŸ¥
    echo ""
    echo "ğŸ“‹ è¯­æ³•æ£€æŸ¥:"
    if bash -n "$script_file"; then
        echo "âœ… è¯­æ³•æ£€æŸ¥é€šè¿‡"
    else
        echo "âŒ è¯­æ³•æ£€æŸ¥å¤±è´¥"
        check_passed=false
    fi
    
    # 3. å®‰å…¨æ£€æŸ¥
    echo ""
    echo "ğŸ“‹ å®‰å…¨æ£€æŸ¥:"
    
    # æ£€æŸ¥ç¡¬ç¼–ç å¯†ç 
    if grep -q "password\|passwd" "$script_file"; then
        echo "âš ï¸  è­¦å‘Šï¼šå‘ç°å¯èƒ½çš„ç¡¬ç¼–ç å¯†ç "
        check_passed=false
    fi
    
    # æ£€æŸ¥å±é™©å‘½ä»¤
    local dangerous_commands="rm -rf|dd|mkfs|fdisk"
    if grep -E "$dangerous_commands" "$script_file" >/dev/null; then
        echo "âš ï¸  è­¦å‘Šï¼šå‘ç°æ½œåœ¨å±é™©å‘½ä»¤"
    fi
    
    # æ£€æŸ¥æ–‡ä»¶æƒé™æ“ä½œ
    if grep -E "chmod 777|chmod.*\+w.*/" "$script_file" >/dev/null; then
        echo "âš ï¸  è­¦å‘Šï¼šå‘ç°ä¸å®‰å…¨çš„æƒé™è®¾ç½®"
    fi
    
    # 4. ä¾èµ–æ£€æŸ¥
    echo ""
    echo "ğŸ“‹ ä¾èµ–æ£€æŸ¥:"
    local missing_commands=()
    
    # æå–è„šæœ¬ä¸­ä½¿ç”¨çš„å¤–éƒ¨å‘½ä»¤
    local commands=$(grep -oh '\b[a-z][a-z0-9_]*\b' "$script_file" | sort -u)
    
    for cmd in awk sed grep sort uniq cut tr wc head tail; do
        if echo "$commands" | grep -q "^$cmd$"; then
            if ! command -v "$cmd" >/dev/null; then
                missing_commands+=("$cmd")
            fi
        fi
    done
    
    if [ ${#missing_commands[@]} -eq 0 ]; then
        echo "âœ… æ‰€æœ‰ä¾èµ–å‘½ä»¤éƒ½å¯ç”¨"
    else
        echo "âŒ ç¼ºå°‘ä¾èµ–å‘½ä»¤: ${missing_commands[*]}"
        check_passed=false
    fi
    
    # 5. é…ç½®æ£€æŸ¥
    echo ""
    echo "ğŸ“‹ é…ç½®æ£€æŸ¥:"
    
    # æ£€æŸ¥æ˜¯å¦æœ‰é…ç½®æ–‡ä»¶
    if grep -q "source\|\..*\.sh" "$script_file"; then
        echo "ğŸ“„ è„šæœ¬ä½¿ç”¨äº†é…ç½®æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨"
    fi
    
    # æ£€æŸ¥æ—¥å¿—ç›®å½•
    if grep -q "/var/log\|LOG_" "$script_file"; then
        echo "ğŸ“„ è„šæœ¬ä½¿ç”¨äº†æ—¥å¿—åŠŸèƒ½ï¼Œè¯·ç¡®ä¿æ—¥å¿—ç›®å½•å¯å†™"
    fi
    
    echo ""
    if [ "$check_passed" = true ]; then
        echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥éƒ¨ç½²"
        return 0
    else
        echo "âŒ æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·ä¿®å¤é—®é¢˜åé‡æ–°æ£€æŸ¥"
        return 1
    fi
}
```

### 8.3 å®‰å…¨é…ç½®


**ğŸ”¸ æƒé™è®¾ç½®**
```bash
# å®‰å…¨æƒé™è®¾ç½®
setup_secure_permissions() {
    local script_file=$1
    local config_dir=${2:-"/etc/scripts"}
    local log_dir=${3:-"/var/log/scripts"}
    local data_dir=${4:-"/var/data/scripts"}
    
    echo "ğŸ”’ è®¾ç½®å®‰å…¨æƒé™"
    
    # 1. åˆ›å»ºå¿…è¦ç›®å½•
    for dir in "$config_dir" "$log_dir" "$data_dir"; do
        if [ ! -d "$dir" ]; then
            sudo mkdir -p "$dir"
            echo "ğŸ“ åˆ›å»ºç›®å½•: $dir"
        fi
    done
    
    # 2. è®¾ç½®è„šæœ¬æƒé™
    sudo chmod 755 "$script_file"  # æ‰€æœ‰è€…å¯æ‰§è¡Œï¼Œå…¶ä»–ç”¨æˆ·åªè¯»
    sudo chown root:root "$script_file"  # å±ä¸»ä¸ºroot
    echo "âœ… è„šæœ¬æƒé™è®¾ç½®å®Œæˆ"
    
    # 3. è®¾ç½®ç›®å½•æƒé™
    sudo chmod 755 "$config_dir"  # é…ç½®ç›®å½•
    sudo chmod 755 "$log_dir"     # æ—¥å¿—ç›®å½•
    sudo chmod 755 "$data_dir"    # æ•°æ®ç›®å½•
    
    # 4. è®¾ç½®ç›®å½•æ‰€æœ‰è€…
    sudo chown root:root "$config_dir"
    sudo chown root:root "$log_dir"
    sudo chown root:root "$data_dir"
    
    echo "âœ… ç›®å½•æƒé™è®¾ç½®å®Œæˆ"
}
```

**ğŸ”¸ ç¯å¢ƒå˜é‡é…ç½®**
```bash
# ç”Ÿäº§ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
create_production_config() {
    local config_file="/etc/scripts/production.conf"
    
    echo "ğŸ“ åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®"
    
    sudo tee "$config_file" > /dev/null << 'EOF'
# ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
# ==================

# åŸºç¡€è·¯å¾„é…ç½®
SCRIPT_HOME="/opt/scripts"
DATA_DIR="/var/data/scripts"
LOG_DIR="/var/log/scripts"
BACKUP_DIR="/backup/scripts"
TEMP_DIR="/tmp/scripts"

# æ—¥å¿—é…ç½®
LOG_LEVEL="INFO"
LOG_ROTATION_SIZE="100M"
LOG_RETENTION_DAYS="30"

# æ€§èƒ½é…ç½®
MAX_MEMORY_MB="1024"
MAX_EXECUTION_TIME="3600"
MAX_CONCURRENT_JOBS="4"

# å®‰å…¨é…ç½®
ALLOW_ROOT_EXECUTION="false"
REQUIRE_SUDO="true"
ENABLE_AUDIT_LOG="true"

# é‚®ä»¶é€šçŸ¥é…ç½®
ADMIN_EMAIL="admin@company.com"
NOTIFICATION_ENABLED="true"
ERROR_NOTIFICATION="true"

# æ•°æ®åº“é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
DB_CONNECTION_TIMEOUT="30"
DB_MAX_CONNECTIONS="10"
EOF

    sudo chmod 644 "$config_file"
    echo "âœ… é…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆ: $config_file"
}
```

### 8.4 ç›‘æ§å’Œå‘Šè­¦


**ğŸ”¸ æ‰§è¡ŒçŠ¶æ€ç›‘æ§**
```bash
# è„šæœ¬æ‰§è¡ŒçŠ¶æ€ç›‘æ§
setup_monitoring() {
    local script_name=$1
    local monitor_dir="/var/run/scripts"
    
    echo "ğŸ“Š è®¾ç½®æ‰§è¡Œç›‘æ§"
    
    # åˆ›å»ºç›‘æ§ç›®å½•
    sudo mkdir -p "$monitor_dir"
    sudo chmod 755 "$monitor_dir"
    
    # åˆ›å»ºçŠ¶æ€æ–‡ä»¶
    local status_file="${monitor_dir}/${script_name}.status"
    local pid_file="${monitor_dir}/${script_name}.pid"
    local lock_file="${monitor_dir}/${script_name}.lock"
    
    echo "ç›‘æ§æ–‡ä»¶ä½ç½®:"
    echo "   çŠ¶æ€æ–‡ä»¶: $status_file"
    echo "   PIDæ–‡ä»¶: $pid_file"
    echo "   é”æ–‡ä»¶: $lock_file"
}

# å†™å…¥æ‰§è¡ŒçŠ¶æ€
update_script_status() {
    local script_name=$1
    local status=$2
    local message=${3:-""}
    local status_file="/var/run/scripts/${script_name}.status"
    
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # æ›´æ–°çŠ¶æ€æ–‡ä»¶
    {
        echo "SCRIPT_NAME=$script_name"
        echo "STATUS=$status"
        echo "TIMESTAMP=$timestamp"
        echo "PID=$"
        echo "MESSAGE=$message"
    } > "$status_file"
    
    # è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—
    logger -t "$script_name" "$status: $message"
}

# æ£€æŸ¥è„šæœ¬æ˜¯å¦æ­£åœ¨è¿è¡Œ
check_script_running() {
    local script_name=$1
    local pid_file="/var/run/scripts/${script_name}.pid"
    
    if [ -f "$pid_file" ]; then
        local pid=$(cat "$pid_file")
        if kill -0 "$pid" 2>/dev/null; then
            echo "è„šæœ¬æ­£åœ¨è¿è¡Œï¼ŒPID: $pid"
            return 0
        else
            echo "PIDæ–‡ä»¶å­˜åœ¨ä½†è¿›ç¨‹å·²åœæ­¢ï¼Œæ¸…ç†æ–‡ä»¶"
            rm -f "$pid_file"
            return 1
        fi
    else
        return 1
    fi
}
```

**ğŸ”¸ å‘Šè­¦ç³»ç»Ÿ**
```bash
# ç®€å•çš„å‘Šè­¦ç³»ç»Ÿ
send_alert() {
    local level=$1      # INFO, WARN, ERROR, CRITICAL
    local script_name=$2
    local message=$3
    local admin_email=${4:-"admin@company.com"}
    
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local hostname=$(hostname)
    
    # æ ¹æ®çº§åˆ«å†³å®šæ˜¯å¦å‘é€é‚®ä»¶
    case "$level" in
        "ERROR"|"CRITICAL")
            # å‘é€é‚®ä»¶å‘Šè­¦ï¼ˆéœ€è¦é…ç½®é‚®ä»¶ç³»ç»Ÿï¼‰
            if command -v mail >/dev/null; then
                {
                    echo "å‘Šè­¦æ—¶é—´: $timestamp"
                    echo "å‘Šè­¦ä¸»æœº: $hostname"
                    echo "è„šæœ¬åç§°: $script_name"
                    echo "å‘Šè­¦çº§åˆ«: $level"
                    echo "å‘Šè­¦ä¿¡æ¯: $message"
                    echo ""
                    echo "è¯·åŠæ—¶å¤„ç†ï¼"
                } | mail -s "[$level] $script_name æ‰§è¡Œå¼‚å¸¸" "$admin_email"
            fi
            ;;
        "WARN")
            # è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—
            logger -p user.warning -t "$script_name" "$message"
            ;;
        "INFO")
            # åªè®°å½•åˆ°è„šæœ¬æ—¥å¿—
            echo "[$timestamp] [INFO] $message" >> "/var/log/scripts/${script_name}.log"
            ;;
    esac
    
    # æ‰€æœ‰çº§åˆ«éƒ½è¾“å‡ºåˆ°æ§åˆ¶å°
    echo "[$level] $message"
}

# å¥åº·æ£€æŸ¥å‡½æ•°
health_check() {
    local script_name=$1
    
    echo "ğŸ” æ‰§è¡Œå¥åº·æ£€æŸ¥"
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    local disk_usage=$(df /var | awk 'NR==2 {print $5}' | sed 's/%//')
    if [ "$disk_usage" -gt 80 ]; then
        send_alert "WARN" "$script_name" "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: ${disk_usage}%"
    fi
    
    # æ£€æŸ¥å†…å­˜ä½¿ç”¨
    local memory_usage=$(free | awk 'NR==2{printf "%.0f", $3/$2*100}')
    if [ "$memory_usage" -gt 90 ]; then
        send_alert "WARN" "$script_name" "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${memory_usage}%"
    fi
    
    # æ£€æŸ¥è´Ÿè½½
    local load_avg=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | sed 's/,//')
    local cpu_cores=$(nproc)
    
    if (( $(echo "$load_avg > $cpu_cores * 2" | bc -l) )); then
        send_alert "WARN" "$script_name" "ç³»ç»Ÿè´Ÿè½½è¿‡é«˜: $load_avg"
    fi
    
    echo "âœ… å¥åº·æ£€æŸ¥å®Œæˆ"
}
```

### 8.5 å®¹é”™å’Œæ¢å¤æœºåˆ¶


**ğŸ”¸ æ•°æ®å¤‡ä»½ç­–ç•¥**
```bash
# æ•°æ®å¤‡ä»½å‡½æ•°
backup_important_data() {
    local data_dir=$1
    local backup_base_dir=${2:-"/backup"}
    local retention_days=${3:-7}
    
    echo "ğŸ’¾ å¼€å§‹æ•°æ®å¤‡ä»½"
    
    local timestamp=$(date '+%Y%m%d_%H%M%S')
    local backup_dir="${backup_base_dir}/$(basename "$data_dir")_${timestamp}"
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    mkdir -p "$backup_dir"
    
    # æ‰§è¡Œå¤‡ä»½
    if cp -r "$data_dir"/* "$backup_dir/" 2>/dev/null; then
        echo "âœ… æ•°æ®å¤‡ä»½å®Œæˆ: $backup_dir"
        
        # å‹ç¼©å¤‡ä»½
        local compressed_backup="${backup_dir}.tar.gz"
        if tar -czf "$compressed_backup" -C "$backup_base_dir" "$(basename "$backup_dir")"; then
            rm -rf "$backup_dir"  # åˆ é™¤æœªå‹ç¼©ç‰ˆæœ¬
            echo "âœ… å¤‡ä»½å·²å‹ç¼©: $compressed_backup"
        fi
        
        # æ¸…ç†æ—§å¤‡ä»½
        find "$backup_base_dir" -name "$(basename "$data_dir")_*.tar.gz" \
             -type f -mtime +$retention_days -delete
        
        echo "ğŸ§¹ æ—§å¤‡ä»½æ¸…ç†å®Œæˆ"
        return 0
    else
        echo "âŒ æ•°æ®å¤‡ä»½å¤±è´¥"
        send_alert "ERROR" "backup" "æ•°æ®å¤‡ä»½å¤±è´¥: $data_dir"
        return 1
    fi
}
```

**ğŸ”¸ æ•…éšœæ¢å¤æœºåˆ¶**
```bash
# æ•…éšœæ¢å¤å‡½æ•°
setup_recovery_mechanism() {
    local script_name=$1
    local recovery_script="/opt/scripts/${script_name}_recovery.sh"
    
    echo "ğŸ”„ è®¾ç½®æ•…éšœæ¢å¤æœºåˆ¶"
    
    # åˆ›å»ºæ¢å¤è„šæœ¬
    cat > "$recovery_script" << 'EOF'
#!/bin/bash
# è‡ªåŠ¨æ¢å¤è„šæœ¬

SCRIPT_NAME="__SCRIPT_NAME__"
LOG_FILE="/var/log/scripts/${SCRIPT_NAME}_recovery.log"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $*" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥å¹¶æ¢å¤è„šæœ¬
recover_script() {
    log_message "å¼€å§‹æ•…éšœæ¢å¤æ£€æŸ¥"
    
    # æ£€æŸ¥è„šæœ¬æ˜¯å¦å¡æ­»
    local pid_file="/var/run/scripts/${SCRIPT_NAME}.pid"
    
    if [ -f "$pid_file" ]; then
        local pid=$(cat "$pid_file")
        local runtime=$(ps -o etime= -p "$pid" 2>/dev/null | tr -d ' ')
        
        if [ -n "$runtime" ]; then
            log_message "è„šæœ¬æ­£åœ¨è¿è¡Œï¼Œè¿è¡Œæ—¶é—´: $runtime"
            
            # æ£€æŸ¥æ˜¯å¦è¿è¡Œæ—¶é—´è¿‡é•¿ï¼ˆè¶…è¿‡1å°æ—¶ï¼‰
            local runtime_seconds=$(ps -o etimes= -p "$pid" 2>/dev/null | tr -d ' ')
            if [ "$runtime_seconds" -gt 3600 ]; then
                log_message "è„šæœ¬è¿è¡Œæ—¶é—´è¿‡é•¿ï¼Œæ‰§è¡Œå¼ºåˆ¶ç»ˆæ­¢"
                kill -TERM "$pid"
                sleep 10
                
                if kill -0 "$pid" 2>/dev/null; then
                    kill -KILL "$pid"
                    log_message "è„šæœ¬å·²å¼ºåˆ¶ç»ˆæ­¢"
                fi
                
                rm -f "$pid_file"
                return 1
            fi
        else
            log_message "PIDæ–‡ä»¶å­˜åœ¨ä½†è¿›ç¨‹ä¸å­˜åœ¨ï¼Œæ¸…ç†æ–‡ä»¶"
            rm -f "$pid_file"
            return 1
        fi
    else
        log_message "è„šæœ¬æœªåœ¨è¿è¡Œ"
        return 1
    fi
    
    return 0
}

# é‡å¯è„šæœ¬
restart_script() {
    log_message "å°è¯•é‡å¯è„šæœ¬"
    
    # æ¸…ç†ç¯å¢ƒ
    cleanup_environment
    
    # é‡å¯è„šæœ¬
    if /opt/scripts/"${SCRIPT_NAME}".sh &; then
        log_message "è„šæœ¬é‡å¯æˆåŠŸ"
        return 0
    else
        log_message "è„šæœ¬é‡å¯å¤±è´¥"
        return 1
    fi
}

# æ¸…ç†ç¯å¢ƒ
cleanup_environment() {
    log_message "æ¸…ç†è„šæœ¬ç¯å¢ƒ"
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f /tmp/"${SCRIPT_NAME}"_*
    
    # æ¸…ç†é”æ–‡ä»¶
    rm -f /var/run/scripts/"${SCRIPT_NAME}".lock
    
    # æ¸…ç†åƒµå°¸è¿›ç¨‹
    pkill -f "${SCRIPT_NAME}" 2>/dev/null || true
}

# ä¸»æ¢å¤é€»è¾‘
main() {
    if ! recover_script; then
        cleanup_environment
        
        if restart_script; then
            log_message "æ•…éšœæ¢å¤æˆåŠŸ"
            exit 0
        else
            log_message "æ•…éšœæ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥"
            # å‘é€å‘Šè­¦
            logger -p user.crit -t "${SCRIPT_NAME}_recovery" "è„šæœ¬æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥"
            exit 1
        fi
    else
        log_message "è„šæœ¬è¿è¡Œæ­£å¸¸ï¼Œæ— éœ€æ¢å¤"
    fi
}

main "$@"
EOF

    # æ›¿æ¢è„šæœ¬åç§°
    sed -i "s/__SCRIPT_NAME__/$script_name/g" "$recovery_script"
    chmod 755 "$recovery_script"
    
    echo "âœ… æ¢å¤è„šæœ¬åˆ›å»ºå®Œæˆ: $recovery_script"
    
    # è®¾ç½®å®šæ—¶æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
    echo "ğŸ’¡ å»ºè®®è®¾ç½®cronå®šæ—¶ä»»åŠ¡å®šæœŸæ‰§è¡Œæ¢å¤æ£€æŸ¥ï¼š"
    echo "   */10 * * * * $recovery_script"
}
```

### 8.6 éƒ¨ç½²æœ€ä½³å®è·µ


**ğŸ”¸ æ¸è¿›å¼éƒ¨ç½²æµç¨‹**
```bash
# æ¸è¿›å¼éƒ¨ç½²å‡½æ•°
deploy_script_gradually() {
    local script_file=$1
    local script_name=$(basename "$script_file" .sh)
    
    echo "ğŸš€ å¼€å§‹æ¸è¿›å¼éƒ¨ç½²: $script_name"
    
    # é˜¶æ®µ1ï¼šå¼€å‘ç¯å¢ƒéªŒè¯
    echo ""
    echo "ğŸ“‹ é˜¶æ®µ1ï¼šå¼€å‘ç¯å¢ƒéªŒè¯"
    if ! deployment_check "$script_file"; then
        echo "âŒ å¼€å‘ç¯å¢ƒéªŒè¯å¤±è´¥ï¼Œåœæ­¢éƒ¨ç½²"
        return 1
    fi
    
    # é˜¶æ®µ2ï¼šæµ‹è¯•ç¯å¢ƒéƒ¨ç½²
    echo ""
    echo "ğŸ“‹ é˜¶æ®µ2ï¼šæµ‹è¯•ç¯å¢ƒéƒ¨ç½²"
    if deploy_to_test_environment "$script_file"; then
        echo "âœ… æµ‹è¯•ç¯å¢ƒéƒ¨ç½²æˆåŠŸ"
    else
        echo "âŒ æµ‹è¯•ç¯å¢ƒéƒ¨ç½²å¤±è´¥ï¼Œåœæ­¢éƒ¨ç½²"
        return 1
    fi
    
    # é˜¶æ®µ3ï¼šé¢„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
    echo ""
    echo "ğŸ“‹ é˜¶æ®µ3ï¼šé¢„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"
    if deploy_to_staging_environment "$script_file"; then
        echo "âœ… é¢„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æˆåŠŸ"
    else
        echo "âŒ é¢„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¤±è´¥ï¼Œåœæ­¢éƒ¨ç½²"
        return 1
    fi
    
    # é˜¶æ®µ4ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
    echo ""
    echo "ğŸ“‹ é˜¶æ®µ4ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"
    if deploy_to_production_environment "$script_file"; then
        echo "âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æˆåŠŸ"
    else
        echo "âŒ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¤±è´¥"
        return 1
    fi
    
    # é˜¶æ®µ5ï¼šéƒ¨ç½²åéªŒè¯
    echo ""
    echo "ğŸ“‹ é˜¶æ®µ5ï¼šéƒ¨ç½²åéªŒè¯"
    if post_deployment_verification "$script_name"; then
        echo "âœ… éƒ¨ç½²åéªŒè¯æˆåŠŸ"
        echo "ğŸ‰ æ¸è¿›å¼éƒ¨ç½²å®Œæˆï¼"
        return 0
    else
        echo "âŒ éƒ¨ç½²åéªŒè¯å¤±è´¥ï¼Œå»ºè®®å›æ»š"
        return 1
    fi
}

# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®æ–½
deploy_to_production_environment() {
    local script_file=$1
    local script_name=$(basename "$script_file" .sh)
    local production_dir="/opt/scripts"
    local backup_dir="/backup/scripts"
    
    echo "ğŸ¯ å¼€å§‹ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"
    
    # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
    if [ -f "$production_dir/$script_name.sh" ]; then
        local timestamp=$(date '+%Y%m%d_%H%M%S')
        local backup_file="$backup_dir/${script_name}_${timestamp}.sh.bak"
        
        mkdir -p "$backup_dir"
        cp "$production_dir/$script_name.sh" "$backup_file"
        echo "ğŸ“¦ å½“å‰ç‰ˆæœ¬å·²å¤‡ä»½: $backup_file"
    fi
    
    # 2. éƒ¨ç½²æ–°ç‰ˆæœ¬
    cp "$script_file" "$production_dir/$script_name.sh"
    chmod 755 "$production_dir/$script_name.sh"
    chown root:root "$production_dir/$script_name.sh"
    
    # 3. åˆ›å»ºå¿…è¦çš„è¿è¡Œç¯å¢ƒ
    setup_secure_permissions "$production_dir/$script_name.sh"
    create_production_config
    setup_monitoring "$script_name"
    setup_recovery_mechanism "$script_name"
    
    echo "âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®Œæˆ"
    return 0
}

# éƒ¨ç½²åéªŒè¯
post_deployment_verification() {
    local script_name=$1
    local script_file="/opt/scripts/$script_name.sh"
    
    echo "ğŸ” å¼€å§‹éƒ¨ç½²åéªŒè¯"
    
    # 1. è„šæœ¬å¯æ‰§è¡Œæ€§éªŒè¯
    if [ ! -x "$script_file" ]; then
        echo "âŒ è„šæœ¬ä¸å¯æ‰§è¡Œ"
        return 1
    fi
    
    # 2. è¯­æ³•éªŒè¯
    if ! bash -n "$script_file"; then
        echo "âŒ è„šæœ¬è¯­æ³•é”™è¯¯"
        return 1
    fi
    
    # 3. è¿è¡Œç¯å¢ƒéªŒè¯
    if ! "$script_file" --help >/dev/null 2>&1; then
        echo "âš ï¸  è„šæœ¬å¯èƒ½ä¸æ”¯æŒ--helpå‚æ•°ï¼Œå°è¯•å…¶ä»–éªŒè¯"
    fi
    
    # 4. æƒé™éªŒè¯
    local perms=$(stat -c %a "$script_file")
    if [ "$perms" != "755" ]; then
        echo "âŒ è„šæœ¬æƒé™ä¸æ­£ç¡®: $perms"
        return 1
    fi
    
    # 5. ä¾èµ–éªŒè¯
    echo "ğŸ“‹ éªŒè¯ç³»ç»Ÿä¾èµ–..."
    for cmd in awk sed grep sort uniq; do
        if ! command -v "$cmd" >/dev/null; then
            echo "âŒ ç¼ºå°‘ä¾èµ–å‘½ä»¤: $cmd"
            return 1
        fi
    done
    
    echo "âœ… éƒ¨ç½²åéªŒè¯é€šè¿‡"
    return 0
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å·¥å…·ç»„åˆä½¿ç”¨ï¼šé€šè¿‡ç®¡é“è¿æ¥å¤šä¸ªå·¥å…·ï¼Œå½¢æˆæ•°æ®å¤„ç†æµæ°´çº¿
ğŸ”¸ é”™è¯¯å¤„ç†æœºåˆ¶ï¼šä½¿ç”¨set -eã€trapã€çŠ¶æ€æ£€æŸ¥ç­‰ç¡®ä¿è„šæœ¬å¯é æ€§
ğŸ”¸ å‚æ•°éªŒè¯ï¼šæ£€æŸ¥å‚æ•°æ•°é‡ã€ç±»å‹ã€æ ¼å¼ï¼Œæä¾›æ¸…æ™°çš„é”™è¯¯æç¤º
ğŸ”¸ çŠ¶æ€æ£€æµ‹ï¼šä¸ä»…æ£€æŸ¥å‘½ä»¤æ‰§è¡ŒçŠ¶æ€ï¼Œè¿˜è¦éªŒè¯å¤„ç†ç»“æœè´¨é‡
ğŸ”¸ è°ƒè¯•æ—¥å¿—ï¼šé€šè¿‡è°ƒè¯•æ¨¡å¼å’Œæ—¥å¿—ç³»ç»Ÿå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜
ğŸ”¸ å‡½æ•°å°è£…ï¼šå°†å¸¸ç”¨åŠŸèƒ½å°è£…æˆå¯é‡ç”¨å‡½æ•°ï¼Œæé«˜ä»£ç è´¨é‡
ğŸ”¸ æ€§èƒ½ç›‘æ§ï¼šç›‘æ§æ‰§è¡Œæ—¶é—´ã€å†…å­˜ä½¿ç”¨ç­‰æ€§èƒ½æŒ‡æ ‡
ğŸ”¸ ç”Ÿäº§éƒ¨ç½²ï¼šé€šè¿‡å®Œå–„çš„æ£€æŸ¥ã€å¤‡ä»½ã€ç›‘æ§ç¡®ä¿ç”Ÿäº§ç¯å¢ƒç¨³å®š
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Shellè„šæœ¬çš„å·¥ç¨‹åŒ–æ€ç»´**

å·¥ç¨‹åŒ–çš„Shellè„šæœ¬ä¸æ˜¯ç®€å•çš„å‘½ä»¤å †ç Œï¼Œè€Œæ˜¯è¦è€ƒè™‘ï¼š
- **å¯é æ€§**ï¼šå„ç§å¼‚å¸¸æƒ…å†µä¸‹éƒ½èƒ½æ­£ç¡®å¤„ç†
- **å¯ç»´æŠ¤æ€§**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºä¿®æ”¹å’Œæ‰©å±•
- **å¯ç›‘æ§æ€§**ï¼šæ‰§è¡Œè¿‡ç¨‹å¯è¿½æº¯ï¼Œé—®é¢˜å¯å®šä½
- **å¯éƒ¨ç½²æ€§**ï¼šèƒ½å¤Ÿå®‰å…¨åœ°éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**ğŸ”¹ é”™è¯¯å¤„ç†çš„å±‚æ¬¡æ€§**

```
ç³»ç»Ÿçº§é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™ä¸è¶³ã€å‘½ä»¤ä¸å¯ç”¨
é€»è¾‘çº§é”™è¯¯ï¼šæ•°æ®æ ¼å¼é”™è¯¯ã€å¤„ç†ç»“æœå¼‚å¸¸
ä¸šåŠ¡çº§é”™è¯¯ï¼šç»“æœä¸ç¬¦åˆä¸šåŠ¡æœŸæœ›

å¤„ç†ç­–ç•¥ï¼š
- é¢„é˜²ä¸ºä¸»ï¼šäº‹å‰æ£€æŸ¥å’ŒéªŒè¯
- åŠæ—¶å‘ç°ï¼šæ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€ç›‘æ§
- ä¼˜é›…é™çº§ï¼šå‡ºç°é—®é¢˜æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡è‰ºæœ¯**

æ€§èƒ½ä¼˜åŒ–éœ€è¦åœ¨å¤šä¸ªç»´åº¦é—´æ‰¾å¹³è¡¡ï¼š
- **ä»£ç ç®€æ´ vs æ‰§è¡Œæ•ˆç‡**ï¼šæœ‰æ—¶å¤æ‚çš„ä»£ç èƒ½å¸¦æ¥æ›´å¥½æ€§èƒ½
- **å†…å­˜ä½¿ç”¨ vs å¤„ç†é€Ÿåº¦**ï¼šå†…å­˜æ¢æ—¶é—´çš„ç»å…¸æƒè¡¡
- **åŠŸèƒ½å®Œæ•´ vs ç³»ç»Ÿèµ„æº**ï¼šåŠŸèƒ½è¶Šå¤šèµ„æºæ¶ˆè€—è¶Šå¤§

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ è„šæœ¬é›†æˆçš„å®ç”¨å»ºè®®**

| åº”ç”¨åœºæ™¯ | æ¨èå·¥å…·ç»„åˆ | å…³é”®æ³¨æ„ç‚¹ |
|----------|-------------|-----------|
| **æ—¥å¿—åˆ†æ** | `awk + sort + uniq + head` | å¤§æ–‡ä»¶å¤„ç†è€ƒè™‘å†…å­˜é™åˆ¶ |
| **æ•°æ®æŠ¥è¡¨** | `cut + awk + sort + printf` | æ ¼å¼åŒ–è¾“å‡ºæé«˜å¯è¯»æ€§ |
| **æ–‡ä»¶å¤„ç†** | `find + xargs + sed/awk` | å¹¶è¡Œå¤„ç†æé«˜æ•ˆç‡ |
| **æ•°æ®æ¸…æ´—** | `grep + sed + awk` | å¤šé˜¶æ®µå¤„ç†ç¡®ä¿æ•°æ®è´¨é‡ |

**ğŸ›¡ï¸ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**

```
éƒ¨ç½²å‰å‡†å¤‡ï¼š
âœ“ ä»£ç å®¡æŸ¥å’Œæµ‹è¯•
âœ“ ä¾èµ–æ£€æŸ¥å’Œç¯å¢ƒå‡†å¤‡
âœ“ å¤‡ä»½ç­–ç•¥å’Œå›æ»šè®¡åˆ’

éƒ¨ç½²è¿‡ç¨‹ï¼š
âœ“ æ¸è¿›å¼éƒ¨ç½²ï¼ˆå¼€å‘â†’æµ‹è¯•â†’ç”Ÿäº§ï¼‰
âœ“ æƒé™è®¾ç½®å’Œå®‰å…¨é…ç½®
âœ“ ç›‘æ§å‘Šè­¦ç³»ç»Ÿè®¾ç½®

éƒ¨ç½²åç»´æŠ¤ï¼š
âœ“ å®šæœŸå¥åº·æ£€æŸ¥
âœ“ æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
âœ“ æ—¥å¿—åˆ†æå’Œé—®é¢˜æ’æŸ¥
```

### 9.4 å¸¸è§é™·é˜±å’Œé¿å…æ–¹æ³•


**âš ï¸ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ç±»å‹ | å…·ä½“è¡¨ç° | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| **ç®¡é“ä¸­æ–­** | ç®¡é“ä¸­æŸä¸ªå‘½ä»¤å¤±è´¥å¯¼è‡´æ•°æ®ä¸¢å¤± | ä½¿ç”¨ `set -o pipefail` |
| **å˜é‡ä¸ºç©º** | æœªå®šä¹‰å˜é‡å¯¼è‡´è„šæœ¬å¼‚å¸¸ | ä½¿ç”¨ `set -u` å’Œå‚æ•°é»˜è®¤å€¼ |
| **æ–‡ä»¶ç«äº‰** | å¤šä¸ªè„šæœ¬åŒæ—¶æ“ä½œåŒä¸€æ–‡ä»¶ | ä½¿ç”¨æ–‡ä»¶é”æœºåˆ¶ |
| **å†…å­˜æ³„æ¼** | å¤§æ–‡ä»¶å¤„ç†å¯¼è‡´å†…å­˜è€—å°½ | æµå¤„ç†æˆ–åˆ†å—å¤„ç† |
| **æƒé™é—®é¢˜** | ç”Ÿäº§ç¯å¢ƒæƒé™ä¸è¶³ | æå‰éªŒè¯å’Œè®¾ç½®æƒé™ |

**ğŸ’¡ è°ƒè¯•æŠ€å·§æ€»ç»“**

```bash
# è°ƒè¯•å‘½ä»¤ç»„åˆ
bash -x script.sh           # æ˜¾ç¤ºæ‰§è¡Œè¿‡ç¨‹
bash -n script.sh           # è¯­æ³•æ£€æŸ¥
set -euo pipefail          # ä¸¥æ ¼æ¨¡å¼
trap 'echo "Error at line $LINENO"' ERR  # é”™è¯¯æ•è·

# æ€§èƒ½åˆ†æ
time command               # ç®€å•è®¡æ—¶
/usr/bin/time -v command  # è¯¦ç»†èµ„æºä½¿ç”¨
ps aux | grep script      # è¿›ç¨‹ç›‘æ§
```

### 9.5 å­¦ä¹ è¿›é˜¶å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ æ–¹å‘**

1. **é«˜çº§Shellç‰¹æ€§**
   - æ•°ç»„æ“ä½œå’Œå…³è”æ•°ç»„
   - æ­£åˆ™è¡¨è¾¾å¼å’Œæ¨¡å¼åŒ¹é…
   - è¿›ç¨‹é—´é€šä¿¡å’Œä¿¡å·å¤„ç†

2. **ç³»ç»Ÿç®¡ç†å·¥å…·**
   - systemdæœåŠ¡ç®¡ç†
   - cronå®šæ—¶ä»»åŠ¡é«˜çº§ç”¨æ³•
   - æ—¥å¿—ç®¡ç†ç³»ç»Ÿï¼ˆrsyslogã€logrotateï¼‰

3. **è‡ªåŠ¨åŒ–å’Œè¿ç»´**
   - CI/CDé›†æˆ
   - Dockerå®¹å™¨åŒ–éƒ¨ç½²
   - ç›‘æ§ç³»ç»Ÿé›†æˆï¼ˆPrometheusã€Grafanaï¼‰

**ğŸ¯ å®è·µé¡¹ç›®å»ºè®®**

- **æ—¥å¿—åˆ†æç³»ç»Ÿ**ï¼šæ„å»ºå®Œæ•´çš„æ—¥å¿—æ”¶é›†ã€åˆ†æã€æŠ¥å‘Šç³»ç»Ÿ
- **æ•°æ®å¤‡ä»½å·¥å…·**ï¼šå¼€å‘è‡ªåŠ¨åŒ–å¤‡ä»½å’Œæ¢å¤å·¥å…·
- **ç³»ç»Ÿç›‘æ§è„šæœ¬**ï¼šåˆ›å»ºå…¨é¢çš„ç³»ç»Ÿå¥åº·æ£€æŸ¥å·¥å…·
- **æ‰¹å¤„ç†ä»»åŠ¡è°ƒåº¦å™¨**ï¼šå®ç°ä»»åŠ¡é˜Ÿåˆ—å’Œä¾èµ–ç®¡ç†

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Shellè„šæœ¬é›†æˆä¸æ˜¯ç®€å•çš„å‘½ä»¤æ‹¼æ¥ï¼Œè€Œæ˜¯ç³»ç»Ÿå·¥ç¨‹
- é”™è¯¯å¤„ç†å’ŒçŠ¶æ€æ£€æµ‹æ˜¯è„šæœ¬å¯é æ€§çš„åŸºç¡€
- å‡½æ•°å°è£…å’Œæ¨¡å—åŒ–æ˜¯ä»£ç è´¨é‡çš„ä¿è¯
- æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–æ˜¯ç”Ÿäº§åº”ç”¨çš„å¿…éœ€
- æ¸è¿›å¼éƒ¨ç½²å’Œå®Œå–„ç›‘æ§æ˜¯ç”Ÿäº§ç¯å¢ƒæˆåŠŸçš„å…³é”®