---
title: 23ã€ä¸€é”®å¤„ç†è„šæœ¬æ¨¡æ¿
---
## ğŸ“š ç›®å½•


1. [è„šæœ¬è‡ªåŠ¨åŒ–æ¦‚è¿°](#1-è„šæœ¬è‡ªåŠ¨åŒ–æ¦‚è¿°)
2. [é€šç”¨æ•°æ®å¤„ç†æ¡†æ¶](#2-é€šç”¨æ•°æ®å¤„ç†æ¡†æ¶)
3. [å‚æ•°é…ç½®ä¸é€‰é¡¹å¤„ç†](#3-å‚æ•°é…ç½®ä¸é€‰é¡¹å¤„ç†)
4. [æ‰¹é‡æ–‡ä»¶å¤„ç†æ¨¡æ¿](#4-æ‰¹é‡æ–‡ä»¶å¤„ç†æ¨¡æ¿)
5. [é”™è¯¯å¤„ç†ä¸å›æ»šæœºåˆ¶](#5-é”™è¯¯å¤„ç†ä¸å›æ»šæœºåˆ¶)
6. [è¿›åº¦æ˜¾ç¤ºä¸æ—¥å¿—ç³»ç»Ÿ](#6-è¿›åº¦æ˜¾ç¤ºä¸æ—¥å¿—ç³»ç»Ÿ)
7. [è„šæœ¬æ‰§è¡Œç¯å¢ƒæ£€æŸ¥](#7-è„šæœ¬æ‰§è¡Œç¯å¢ƒæ£€æŸ¥)
8. [ç»“æœéªŒè¯ä¸è´¨é‡æ§åˆ¶](#8-ç»“æœéªŒè¯ä¸è´¨é‡æ§åˆ¶)
9. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¨¡æ¿](#9-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¨¡æ¿)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ è„šæœ¬è‡ªåŠ¨åŒ–æ¦‚è¿°



### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ä¸€é”®å¤„ç†è„šæœ¬



**å®é™…ç—›ç‚¹**ï¼šæƒ³è±¡ä½ æ¯å¤©è¦å¤„ç†100ä¸ªæ•°æ®æ–‡ä»¶ï¼Œæ‰‹åŠ¨æ“ä½œéœ€è¦é‡å¤ç›¸åŒçš„æ­¥éª¤100æ¬¡ï¼Œä¸ä»…æµªè´¹æ—¶é—´ï¼Œè¿˜å®¹æ˜“å‡ºé”™ã€‚

```
ğŸ”¸ æ‰‹åŠ¨å¤„ç†çš„é—®é¢˜ï¼š
â€¢ é‡å¤æ€§åŠ³åŠ¨ï¼šç›¸åŒæ“ä½œåå¤æ‰§è¡Œ
â€¢ å®¹æ˜“å‡ºé”™ï¼šäººå·¥æ“ä½œéš¾å…ç–å¿½
â€¢ æ•ˆç‡ä½ä¸‹ï¼šå¤§é‡æ—¶é—´æµªè´¹åœ¨æœºæ¢°æ“ä½œä¸Š
â€¢ éš¾ä»¥è¿½è¸ªï¼šæ— æ³•è®°å½•å¤„ç†è¿‡ç¨‹å’Œç»“æœ
â€¢ æ— æ³•å¤ç°ï¼šå¤„ç†æ­¥éª¤éš¾ä»¥æ ‡å‡†åŒ–

ğŸ”¸ è‡ªåŠ¨åŒ–è„šæœ¬çš„ä»·å€¼ï¼š
â€¢ ä¸€æ¬¡ç¼–å†™ï¼Œåå¤ä½¿ç”¨
â€¢ å‡å°‘äººä¸ºé”™è¯¯
â€¢ æé«˜å¤„ç†æ•ˆç‡
â€¢ æ ‡å‡†åŒ–å¤„ç†æµç¨‹
â€¢ ä¾¿äºç»´æŠ¤å’Œæ”¹è¿›
```

### 1.2 è„šæœ¬è‡ªåŠ¨åŒ–çš„æ ¸å¿ƒæ€æƒ³



**è®¾è®¡ç†å¿µ**ï¼šå¥½çš„è‡ªåŠ¨åŒ–è„šæœ¬å°±åƒä¸€ä¸ªè´´å¿ƒçš„åŠ©æ‰‹ï¼Œä¸ä»…èƒ½å®Œæˆä»»åŠ¡ï¼Œè¿˜èƒ½å‘Šè¯‰ä½ è¿›åº¦ã€å¤„ç†å¼‚å¸¸ã€éªŒè¯ç»“æœã€‚

```
ğŸ“Š è„šæœ¬æ¶æ„è®¾è®¡ï¼š

è¾“å…¥é˜¶æ®µï¼šå‚æ•°è§£æ + ç¯å¢ƒæ£€æŸ¥
    â†“
å¤„ç†é˜¶æ®µï¼šæ ¸å¿ƒé€»è¾‘ + è¿›åº¦ç›‘æ§
    â†“
è¾“å‡ºé˜¶æ®µï¼šç»“æœéªŒè¯ + æ—¥å¿—è®°å½•
    â†“
æ¸…ç†é˜¶æ®µï¼šèµ„æºé‡Šæ”¾ + é”™è¯¯å›æ»š

å…³é”®è®¾è®¡åŸåˆ™ï¼š
âœ“ å¥å£®æ€§ï¼šèƒ½åº”å¯¹å„ç§å¼‚å¸¸æƒ…å†µ
âœ“ å¯è¯»æ€§ï¼šä»£ç æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
âœ“ å¯æ‰©å±•ï¼šä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
âœ“ ç”¨æˆ·å‹å¥½ï¼šæä¾›æ¸…æ™°çš„åé¦ˆä¿¡æ¯
```

### 1.3 è„šæœ¬æ¨¡æ¿çš„é€‚ç”¨åœºæ™¯



**ğŸ’¼ å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
```
æ•°æ®å¤„ç†åœºæ™¯ï¼š
â€¢ æ—¥å¿—æ–‡ä»¶åˆ†æå’Œæ¸…ç†
â€¢ æ•°æ®æ ¼å¼è½¬æ¢å’Œæ•´ç†
â€¢ æ‰¹é‡æ–‡ä»¶é‡å‘½åå’Œç§»åŠ¨
â€¢ å®šæœŸå¤‡ä»½å’Œå½’æ¡£æ“ä½œ

ç³»ç»Ÿç®¡ç†åœºæ™¯ï¼š
â€¢ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥å’Œç›‘æ§
â€¢ è½¯ä»¶éƒ¨ç½²å’Œé…ç½®æ›´æ–°
â€¢ ç”¨æˆ·è´¦æˆ·æ‰¹é‡ç®¡ç†
â€¢ æœåŠ¡å¯åœå’Œå¥åº·æ£€æŸ¥

å¼€å‘è¿ç»´åœºæ™¯ï¼š
â€¢ ä»£ç æ„å»ºå’Œéƒ¨ç½²
â€¢ æµ‹è¯•ç¯å¢ƒæ­å»º
â€¢ æ€§èƒ½ç›‘æ§å’ŒæŠ¥å‘Š
â€¢ æ•…éšœæ’æŸ¥å’Œæ¢å¤
```

---

## 2. ğŸ—ï¸ é€šç”¨æ•°æ®å¤„ç†æ¡†æ¶



### 2.1 æ ‡å‡†è„šæœ¬ç»“æ„æ¨¡æ¿



ä¸€ä¸ªå®Œæ•´çš„å¤„ç†è„šæœ¬åº”è¯¥åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰æ˜ç¡®çš„èŒè´£ï¼š

```bash
#!/bin/bash

# =================================================================

# é€šç”¨æ•°æ®å¤„ç†è„šæœ¬æ¨¡æ¿

# ä½œè€…ï¼š[Your Name]

# ç‰ˆæœ¬ï¼š1.0

# æè¿°ï¼šç”¨äºæ‰¹é‡å¤„ç†æ•°æ®æ–‡ä»¶çš„é€šç”¨æ¨¡æ¿

# =================================================================


# è®¾ç½®è„šæœ¬æ‰§è¡Œæ¨¡å¼

set -euo pipefail  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡ºï¼Œæœªå®šä¹‰å˜é‡æŠ¥é”™

# å…¨å±€å˜é‡å®šä¹‰

readonly SCRIPT_NAME=$(basename "$0")
readonly SCRIPT_DIR=$(cd "$(dirname "$0")" && pwd)
readonly LOG_FILE="${SCRIPT_DIR}/logs/$(date +%Y%m%d_%H%M%S)_${SCRIPT_NAME%.*}.log"

# é»˜è®¤é…ç½®

DEFAULT_INPUT_DIR="./input"
DEFAULT_OUTPUT_DIR="./output"
DEFAULT_BACKUP_DIR="./backup"
```

### 2.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—åˆ’åˆ†



**ğŸ“¦ åŠŸèƒ½æ¨¡å—åŒ–è®¾è®¡**ï¼š
```bash
# ä¸»è¦åŠŸèƒ½æ¨¡å—

main() {
#    # 1. åˆå§‹åŒ–é˜¶æ®µ
    initialize_script
    
#    # 2. ç¯å¢ƒæ£€æŸ¥
    check_environment
    
#    # 3. å‚æ•°å¤„ç†
    parse_arguments "$@"
    
#    # 4. æ ¸å¿ƒå¤„ç†é€»è¾‘
    process_data
    
#    # 5. ç»“æœéªŒè¯
    validate_results
    
#    # 6. æ¸…ç†å·¥ä½œ
    cleanup
}

# åˆå§‹åŒ–å‡½æ•°

initialize_script() {
#    # åˆ›å»ºå¿…è¦ç›®å½•
    mkdir -p "$(dirname "$LOG_FILE")" "$DEFAULT_OUTPUT_DIR" "$DEFAULT_BACKUP_DIR"
    
#    # è®°å½•è„šæœ¬å¼€å§‹æ—¶é—´
    echo "$(date '+%Y-%m-%d %H:%M:%S') - è„šæœ¬å¼€å§‹æ‰§è¡Œ" >> "$LOG_FILE"
    
#    # è®¾ç½®ä¿¡å·å¤„ç†
    trap 'handle_interrupt' INT TERM
}
```

### 2.3 æ•°æ®å¤„ç†æ ¸å¿ƒé€»è¾‘



**ğŸ”§ å¤„ç†æµç¨‹æ ‡å‡†åŒ–**ï¼š
```bash
process_data() {
    local input_dir="$1"
    local output_dir="$2"
    local total_files=0
    local processed_files=0
    
#    # ç»Ÿè®¡å¾…å¤„ç†æ–‡ä»¶æ•°é‡
    total_files=$(find "$input_dir" -name "*.txt" -type f | wc -l)
    
    if [ "$total_files" -eq 0 ]; then
        log_message "WARNING" "æœªæ‰¾åˆ°å¾…å¤„ç†çš„æ–‡ä»¶"
        return 1
    fi
    
    log_message "INFO" "æ‰¾åˆ° $total_files ä¸ªæ–‡ä»¶å¾…å¤„ç†"
    
#    # é€ä¸ªå¤„ç†æ–‡ä»¶
    while IFS= read -r -d '' file; do
        if process_single_file "$file" "$output_dir"; then
            ((processed_files++))
            show_progress "$processed_files" "$total_files"
        else
            log_message "ERROR" "å¤„ç†æ–‡ä»¶å¤±è´¥: $file"
        fi
    done < <(find "$input_dir" -name "*.txt" -type f -print0)
    
    log_message "INFO" "å¤„ç†å®Œæˆï¼ŒæˆåŠŸå¤„ç† $processed_files/$total_files ä¸ªæ–‡ä»¶"
}
```

### 2.4 å•æ–‡ä»¶å¤„ç†æ¨¡æ¿



**ğŸ“„ æ ‡å‡†åŒ–å•æ–‡ä»¶å¤„ç†**ï¼š
```bash
process_single_file() {
    local input_file="$1"
    local output_dir="$2"
    local filename=$(basename "$input_file")
    local output_file="${output_dir}/${filename%.txt}_processed.txt"
    
#    # éªŒè¯è¾“å…¥æ–‡ä»¶
    if [[ ! -f "$input_file" ]] || [[ ! -r "$input_file" ]]; then
        log_message "ERROR" "æ— æ³•è¯»å–æ–‡ä»¶: $input_file"
        return 1
    fi
    
#    # åˆ›å»ºå¤‡ä»½
    if ! cp "$input_file" "${DEFAULT_BACKUP_DIR}/${filename}.backup"; then
        log_message "ERROR" "åˆ›å»ºå¤‡ä»½å¤±è´¥: $input_file"
        return 1
    fi
    
#    # æ ¸å¿ƒå¤„ç†é€»è¾‘ï¼ˆè¿™é‡Œå¯ä»¥æ›¿æ¢ä¸ºå…·ä½“çš„å¤„ç†å‘½ä»¤ï¼‰
    if sed 's/old_pattern/new_pattern/g' "$input_file" > "$output_file"; then
        log_message "INFO" "æˆåŠŸå¤„ç†: $filename"
        return 0
    else
        log_message "ERROR" "å¤„ç†å¤±è´¥: $filename"
        return 1
    fi
}
```

---

## 3. âš™ï¸ å‚æ•°é…ç½®ä¸é€‰é¡¹å¤„ç†



### 3.1 å‚æ•°å¤„ç†çš„é‡è¦æ€§



**ä¸ºä»€ä¹ˆéœ€è¦çµæ´»çš„å‚æ•°å¤„ç†ï¼Ÿ**
å°±åƒä½¿ç”¨ç‘å£«å†›åˆ€ä¸€æ ·ï¼ŒåŒä¸€ä¸ªå·¥å…·åœ¨ä¸åŒåœºæ™¯ä¸‹éœ€è¦ä¸åŒçš„é…ç½®ï¼Œå‚æ•°å¤„ç†è®©è„šæœ¬å˜å¾—çµæ´»å¯é…ã€‚

```
ğŸ¯ å‚æ•°å¤„ç†çš„ä»·å€¼ï¼š
â€¢ æé«˜è„šæœ¬å¤ç”¨æ€§ï¼šåŒä¸€è„šæœ¬é€‚åº”ä¸åŒåœºæ™¯
â€¢ å¢å¼ºç”¨æˆ·ä½“éªŒï¼šæä¾›æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜
â€¢ ä¾¿äºè°ƒè¯•æµ‹è¯•ï¼šå¯ä»¥å¿«é€Ÿåˆ‡æ¢ä¸åŒé…ç½®
â€¢ æ”¯æŒæ‰¹é‡æ“ä½œï¼šé€šè¿‡å‚æ•°æ§åˆ¶å¤„ç†èŒƒå›´
```

### 3.2 æ ‡å‡†å‚æ•°è§£æå®ç°



```bash
# å‚æ•°é»˜è®¤å€¼

INPUT_DIR="$DEFAULT_INPUT_DIR"
OUTPUT_DIR="$DEFAULT_OUTPUT_DIR"
BACKUP_ENABLED=true
VERBOSE=false
DRY_RUN=false

# æ˜¾ç¤ºä½¿ç”¨è¯´æ˜

show_usage() {
    cat << EOF
ä½¿ç”¨è¯´æ˜: $SCRIPT_NAME [é€‰é¡¹] [å‚æ•°]

é€‰é¡¹:
    -i, --input DIR     æŒ‡å®šè¾“å…¥ç›®å½• (é»˜è®¤: $DEFAULT_INPUT_DIR)
    -o, --output DIR    æŒ‡å®šè¾“å‡ºç›®å½• (é»˜è®¤: $DEFAULT_OUTPUT_DIR)
    -b, --no-backup     ç¦ç”¨å¤‡ä»½åŠŸèƒ½
    -v, --verbose       æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
    -n, --dry-run       é¢„æ¼”æ¨¡å¼ï¼Œä¸æ‰§è¡Œå®é™…æ“ä½œ
    -h, --help          æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯

ç¤ºä¾‹:
    $SCRIPT_NAME -i /data/input -o /data/output -v
    $SCRIPT_NAME --dry-run --no-backup
    
EOF
}

# å‚æ•°è§£æå‡½æ•°

parse_arguments() {
    while [[ $# -gt 0 ]]; do
        case $1 in
            -i|--input)
                INPUT_DIR="$2"
                shift 2
                ;;
            -o|--output)
                OUTPUT_DIR="$2"
                shift 2
                ;;
            -b|--no-backup)
                BACKUP_ENABLED=false
                shift
                ;;
            -v|--verbose)
                VERBOSE=true
                shift
                ;;
            -n|--dry-run)
                DRY_RUN=true
                shift
                ;;
            -h|--help)
                show_usage
                exit 0
                ;;
            *)
                echo "æœªçŸ¥å‚æ•°: $1" >&2
                show_usage
                exit 1
                ;;
        esac
    done
    
#    # éªŒè¯å‚æ•°
    validate_arguments
}
```

### 3.3 é…ç½®æ–‡ä»¶æ”¯æŒ



**ğŸ“‹ é…ç½®æ–‡ä»¶å¢å¼ºçµæ´»æ€§**ï¼š
```bash
# é…ç½®æ–‡ä»¶è·¯å¾„

readonly CONFIG_FILE="${SCRIPT_DIR}/config.conf"

# åŠ è½½é…ç½®æ–‡ä»¶

load_config() {
    if [[ -f "$CONFIG_FILE" ]]; then
        log_message "INFO" "åŠ è½½é…ç½®æ–‡ä»¶: $CONFIG_FILE"
        
#        # å®‰å…¨åœ°è¯»å–é…ç½®æ–‡ä»¶
        while IFS='=' read -r key value; do
#            # è·³è¿‡æ³¨é‡Šå’Œç©ºè¡Œ
            [[ $key =~ ^[[:space:]]*# ]] && continue
            [[ -z $key ]] && continue
            
#            # å»é™¤å‰åç©ºç™½å­—ç¬¦
            key=$(echo "$key" | xargs)
            value=$(echo "$value" | xargs)
            
#            # è®¾ç½®é…ç½®å˜é‡
            case "$key" in
                "INPUT_DIR")
                    INPUT_DIR="$value"
                    ;;
                "OUTPUT_DIR")
                    OUTPUT_DIR="$value"
                    ;;
                "BACKUP_ENABLED")
                    BACKUP_ENABLED="$value"
                    ;;
                "LOG_LEVEL")
                    LOG_LEVEL="$value"
                    ;;
            esac
        done < "$CONFIG_FILE"
    else
        log_message "INFO" "æœªæ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨é»˜è®¤é…ç½®"
    fi
}
```

**ğŸ”§ ç¤ºä¾‹é…ç½®æ–‡ä»¶æ ¼å¼**ï¼š
```ini
# æ•°æ®å¤„ç†è„šæœ¬é…ç½®æ–‡ä»¶

# æ³¨é‡Šä»¥ # å¼€å¤´


# ç›®å½•é…ç½®

INPUT_DIR=/data/input
OUTPUT_DIR=/data/output
BACKUP_ENABLED=true

# æ—¥å¿—é…ç½®

LOG_LEVEL=INFO
VERBOSE=false

# å¤„ç†é…ç½®

BATCH_SIZE=100
TIMEOUT=300
```

---

## 4. ğŸ“ æ‰¹é‡æ–‡ä»¶å¤„ç†æ¨¡æ¿



### 4.1 æ–‡ä»¶å‘ç°ä¸è¿‡æ»¤



**æ™ºèƒ½æ–‡ä»¶åŒ¹é…**ï¼šå¤„ç†å¤§é‡æ–‡ä»¶æ—¶ï¼Œéœ€è¦æ™ºèƒ½çš„ç­›é€‰æœºåˆ¶ï¼Œå°±åƒåœ¨å›¾ä¹¦é¦†æ‰¾ä¹¦ä¸€æ ·ï¼Œéœ€è¦æ˜ç¡®çš„åˆ†ç±»æ ‡å‡†ã€‚

```bash
# æ–‡ä»¶å‘ç°å‡½æ•°

find_target_files() {
    local search_dir="$1"
    local pattern="$2"
    local min_size="${3:-1c}"  # æœ€å°æ–‡ä»¶å¤§å°
    local max_age="${4:-30}"   # æœ€å¤§æ–‡ä»¶å¤©æ•°
    
    find "$search_dir" \
        -name "$pattern" \
        -type f \
        -size +$min_size \
        -mtime -$max_age \
        -readable \
        2>/dev/null
}

# æ–‡ä»¶ç­›é€‰ç­–ç•¥

filter_files() {
    local input_files=("$@")
    local filtered_files=()
    
    for file in "${input_files[@]}"; do
#        # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
        if ! validate_file_integrity "$file"; then
            log_message "WARN" "è·³è¿‡æŸåæ–‡ä»¶: $file"
            continue
        fi
        
#        # æ£€æŸ¥æ–‡ä»¶æ ¼å¼
        if ! check_file_format "$file"; then
            log_message "WARN" "è·³è¿‡æ ¼å¼ä¸ç¬¦æ–‡ä»¶: $file"
            continue
        fi
        
        filtered_files+=("$file")
    done
    
    printf '%s\n' "${filtered_files[@]}"
}
```

### 4.2 å¹¶è¡Œå¤„ç†æ¡†æ¶



**âš¡ æå‡å¤„ç†æ•ˆç‡**ï¼š
```bash
# å¹¶è¡Œå¤„ç†æ§åˆ¶

readonly MAX_PARALLEL_JOBS=4
readonly JOB_QUEUE_FILE="/tmp/${SCRIPT_NAME}_queue.$$"

# å¹¶è¡Œå¤„ç†ä¸»å‡½æ•°

process_files_parallel() {
    local files=("$@")
    local total_files=${#files[@]}
    local completed_jobs=0
    
#    # åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—
    printf '%s\n' "${files[@]}" > "$JOB_QUEUE_FILE"
    
#    # å¯åŠ¨å·¥ä½œè¿›ç¨‹
    for ((i=1; i<=MAX_PARALLEL_JOBS; i++)); do
        process_worker "$i" &
        echo $! >> "${JOB_QUEUE_FILE}.pids"
    done
    
#    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    wait_for_completion
    
#    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    cleanup_parallel_resources
}

# å·¥ä½œè¿›ç¨‹å‡½æ•°

process_worker() {
    local worker_id="$1"
    
    while IFS= read -r file; do
        if [[ -n "$file" ]]; then
            log_message "DEBUG" "å·¥ä½œè¿›ç¨‹ $worker_id å¤„ç†: $file"
            
            if process_single_file "$file" "$OUTPUT_DIR"; then
                increment_counter
            fi
        fi
    done < <(get_next_job)
}

# åŸå­æ“ä½œè·å–ä¸‹ä¸€ä¸ªä»»åŠ¡

get_next_job() {
    (
        flock -x 200
        head -1 "$JOB_QUEUE_FILE" 2>/dev/null
        sed -i '1d' "$JOB_QUEUE_FILE" 2>/dev/null
    ) 200>"${JOB_QUEUE_FILE}.lock"
}
```

### 4.3 æ‰¹å¤„ç†ç­–ç•¥ä¼˜åŒ–



**ğŸ“Š å¤„ç†ç­–ç•¥è¡¨**ï¼š

| æ–‡ä»¶æ•°é‡ | **å¤„ç†ç­–ç•¥** | **å¹¶å‘æ•°** | **å†…å­˜ä½¿ç”¨** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-----------|-------------|-------------|
| < 10ä¸ª | `ä¸²è¡Œå¤„ç†` | `1` | `ä½` | `å°è§„æ¨¡ä»»åŠ¡` |
| 10-100ä¸ª | `è½»é‡å¹¶è¡Œ` | `2-4` | `ä¸­ç­‰` | `å¸¸è§„æ‰¹å¤„ç†` |
| 100-1000ä¸ª | `æ ‡å‡†å¹¶è¡Œ` | `4-8` | `ä¸­é«˜` | `å¤§æ‰¹é‡å¤„ç†` |
| > 1000ä¸ª | `åˆ†æ‰¹å¤„ç†` | `8-16` | `å¯æ§` | `è¶…å¤§è§„æ¨¡ä»»åŠ¡` |

**ğŸ”„ åˆ†æ‰¹å¤„ç†å®ç°**ï¼š
```bash
# å¤§æ–‡ä»¶é›†åˆ†æ‰¹å¤„ç†

process_large_dataset() {
    local all_files=("$@")
    local total_files=${#all_files[@]}
    local batch_size=${BATCH_SIZE:-100}
    local batch_count=$(((total_files + batch_size - 1) / batch_size))
    
    log_message "INFO" "æ€»è®¡ $total_files ä¸ªæ–‡ä»¶ï¼Œåˆ† $batch_count æ‰¹å¤„ç†"
    
    for ((batch=0; batch<batch_count; batch++)); do
        local start_idx=$((batch * batch_size))
        local end_idx=$(((batch + 1) * batch_size))
        
#        # æå–å½“å‰æ‰¹æ¬¡æ–‡ä»¶
        local batch_files=("${all_files[@]:$start_idx:$batch_size}")
        
        log_message "INFO" "å¤„ç†ç¬¬ $((batch + 1))/$batch_count æ‰¹ï¼Œå…± ${#batch_files[@]} ä¸ªæ–‡ä»¶"
        
#        # å¤„ç†å½“å‰æ‰¹æ¬¡
        process_files_parallel "${batch_files[@]}"
        
#        # æ‰¹æ¬¡é—´æš‚åœï¼ˆé¿å…ç³»ç»Ÿè¿‡è½½ï¼‰
        if [[ $batch -lt $((batch_count - 1)) ]]; then
            sleep 2
        fi
    done
}
```

---

## 5. ğŸ›¡ï¸ é”™è¯¯å¤„ç†ä¸å›æ»šæœºåˆ¶



### 5.1 é”™è¯¯å¤„ç†ç­–ç•¥



**å®¹é”™è®¾è®¡ç†å¿µ**ï¼šå¥½çš„è„šæœ¬å°±åƒä¸€ä¸ªç»éªŒä¸°å¯Œçš„å¸æœºï¼Œä¸ä»…çŸ¥é“å¦‚ä½•æ­£å¸¸è¡Œé©¶ï¼Œæ›´é‡è¦çš„æ˜¯çŸ¥é“å¦‚ä½•åº”å¯¹çªå‘çŠ¶å†µã€‚

```bash
# é”™è¯¯çº§åˆ«å®šä¹‰

readonly ERROR_LEVEL_INFO=0
readonly ERROR_LEVEL_WARN=1
readonly ERROR_LEVEL_ERROR=2
readonly ERROR_LEVEL_FATAL=3

# å…¨å±€é”™è¯¯è®¡æ•°å™¨

ERROR_COUNT=0
WARNING_COUNT=0

# é”™è¯¯å¤„ç†ä¸»å‡½æ•°

handle_error() {
    local error_level="$1"
    local error_message="$2"
    local line_number="${3:-unknown}"
    local function_name="${4:-main}"
    
    case "$error_level" in
        "WARN")
            ((WARNING_COUNT++))
            log_message "WARN" "[$function_name:$line_number] $error_message"
            ;;
        "ERROR")
            ((ERROR_COUNT++))
            log_message "ERROR" "[$function_name:$line_number] $error_message"
            
#            # ä¸¥é‡é”™è¯¯æ—¶è€ƒè™‘å›æ»š
            if [[ $ERROR_COUNT -gt ${MAX_ERRORS:-5} ]]; then
                trigger_rollback "é”™è¯¯æ•°é‡è¶…è¿‡é˜ˆå€¼"
            fi
            ;;
        "FATAL")
            log_message "FATAL" "[$function_name:$line_number] $error_message"
            trigger_rollback "é‡åˆ°è‡´å‘½é”™è¯¯"
            exit 1
            ;;
    esac
}

# è®¾ç½®é”™è¯¯é™·é˜±

setup_error_handling() {
    set -eE  # å¯ç”¨é”™è¯¯è‡ªåŠ¨é€€å‡ºå’Œé”™è¯¯ç»§æ‰¿
    
#    # æ•è·ERRä¿¡å·
    trap 'handle_error "ERROR" "è„šæœ¬æ‰§è¡Œå‡ºé”™" "$LINENO" "${FUNCNAME[1]}"' ERR
    
#    # æ•è·EXITä¿¡å·
    trap 'cleanup_on_exit' EXIT
}
```

### 5.2 å›æ»šæœºåˆ¶è®¾è®¡



**ğŸ”„ çŠ¶æ€å¿«ç…§ä¸æ¢å¤**ï¼š
```bash
# çŠ¶æ€å¿«ç…§ç®¡ç†

readonly SNAPSHOT_DIR="/tmp/${SCRIPT_NAME}_snapshots.$$"
readonly ROLLBACK_LOG="${SNAPSHOT_DIR}/rollback.log"

# åˆ›å»ºçŠ¶æ€å¿«ç…§

create_snapshot() {
    local snapshot_name="$1"
    local snapshot_path="${SNAPSHOT_DIR}/${snapshot_name}"
    
    mkdir -p "$snapshot_path"
    
#    # è®°å½•å½“å‰çŠ¶æ€
    {
        echo "å¿«ç…§æ—¶é—´: $(date)"
        echo "è¾“å…¥ç›®å½•: $INPUT_DIR"
        echo "è¾“å‡ºç›®å½•: $OUTPUT_DIR" 
        echo "å·²å¤„ç†æ–‡ä»¶æ•°: $PROCESSED_FILES"
    } > "${snapshot_path}/metadata.txt"
    
#    # å¤‡ä»½å…³é”®ç›®å½•çŠ¶æ€
    if [[ -d "$OUTPUT_DIR" ]]; then
        cp -r "$OUTPUT_DIR" "${snapshot_path}/output_backup" 2>/dev/null || true
    fi
    
    log_message "INFO" "åˆ›å»ºçŠ¶æ€å¿«ç…§: $snapshot_name"
}

# æ‰§è¡Œå›æ»šæ“ä½œ

trigger_rollback() {
    local rollback_reason="$1"
    
    log_message "WARN" "å¼€å§‹å›æ»šæ“ä½œï¼ŒåŸå› : $rollback_reason"
    
#    # è®°å½•å›æ»šä¿¡æ¯
    {
        echo "========== å›æ»šè®°å½• =========="
        echo "æ—¶é—´: $(date)"
        echo "åŸå› : $rollback_reason"
        echo "é”™è¯¯è®¡æ•°: $ERROR_COUNT"
        echo "è­¦å‘Šè®¡æ•°: $WARNING_COUNT"
    } >> "$ROLLBACK_LOG"
    
#    # æ¢å¤è¾“å‡ºç›®å½•
    restore_output_directory
    
#    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    cleanup_temp_files
    
#    # æ¢å¤æ–‡ä»¶æƒé™
    restore_file_permissions
    
    log_message "INFO" "å›æ»šæ“ä½œå®Œæˆ"
}

# æ¢å¤è¾“å‡ºç›®å½•

restore_output_directory() {
    if [[ -d "${SNAPSHOT_DIR}/initial/output_backup" ]]; then
        log_message "INFO" "æ¢å¤è¾“å‡ºç›®å½•çŠ¶æ€"
        
#        # æ¸…ç©ºå½“å‰è¾“å‡ºç›®å½•
        rm -rf "${OUTPUT_DIR:?}"/* 2>/dev/null || true
        
#        # æ¢å¤å¤‡ä»½å†…å®¹
        cp -r "${SNAPSHOT_DIR}/initial/output_backup/"* "$OUTPUT_DIR/" 2>/dev/null || true
    fi
}
```

### 5.3 æ•°æ®å®Œæ•´æ€§éªŒè¯



**ğŸ” å¤„ç†ç»“æœæ ¡éªŒ**ï¼š
```bash
# æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥

validate_file_integrity() {
    local file_path="$1"
    
#    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”å¯è¯»
    if [[ ! -f "$file_path" ]] || [[ ! -r "$file_path" ]]; then
        return 1
    fi
    
#    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
    if [[ ! -s "$file_path" ]]; then
        log_message "WARN" "æ–‡ä»¶ä¸ºç©º: $file_path"
        return 1
    fi
    
#    # æ£€æŸ¥æ–‡ä»¶ç¼–ç ï¼ˆé’ˆå¯¹æ–‡æœ¬æ–‡ä»¶ï¼‰
    if file "$file_path" | grep -q "text"; then
        if ! iconv -f UTF-8 -t UTF-8 "$file_path" >/dev/null 2>&1; then
            log_message "WARN" "æ–‡ä»¶ç¼–ç å¼‚å¸¸: $file_path"
            return 1
        fi
    fi
    
    return 0
}

# å¤„ç†ç»“æœéªŒè¯

validate_processing_result() {
    local input_file="$1"
    local output_file="$2"
    
#    # åŸºæœ¬å­˜åœ¨æ€§æ£€æŸ¥
    if [[ ! -f "$output_file" ]]; then
        handle_error "ERROR" "è¾“å‡ºæ–‡ä»¶ä¸å­˜åœ¨: $output_file"
        return 1
    fi
    
#    # æ–‡ä»¶å¤§å°åˆç†æ€§æ£€æŸ¥
    local input_size=$(stat -c%s "$input_file")
    local output_size=$(stat -c%s "$output_file")
    
#    # è¾“å‡ºæ–‡ä»¶ä¸åº”è¯¥æ¯”è¾“å…¥æ–‡ä»¶å°å¤ªå¤š
    if [[ $output_size -lt $((input_size / 10)) ]]; then
        handle_error "WARN" "è¾“å‡ºæ–‡ä»¶å¼‚å¸¸å°: $output_file"
        return 1
    fi
    
    return 0
}
```

---

## 6. ğŸ“Š è¿›åº¦æ˜¾ç¤ºä¸æ—¥å¿—ç³»ç»Ÿ



### 6.1 ç”¨æˆ·å‹å¥½çš„è¿›åº¦æ˜¾ç¤º



**ç›´è§‚çš„è¿›åº¦åé¦ˆ**ï¼šå°±åƒæ‰‹æœºä¸‹è½½åº”ç”¨æ—¶çš„è¿›åº¦æ¡ä¸€æ ·ï¼Œè®©ç”¨æˆ·çŸ¥é“å½“å‰è¿›åº¦å’Œé¢„ä¼°å®Œæˆæ—¶é—´ã€‚

```bash
# è¿›åº¦æ˜¾ç¤ºå‡½æ•°

show_progress() {
    local current="$1"
    local total="$2"
    local prefix="${3:-å¤„ç†è¿›åº¦}"
    
#    # è®¡ç®—ç™¾åˆ†æ¯”
    local percentage=$((current * 100 / total))
    
#    # è®¡ç®—è¿›åº¦æ¡é•¿åº¦
    local bar_length=40
    local filled_length=$((percentage * bar_length / 100))
    
#    # æ„å»ºè¿›åº¦æ¡
    local bar=""
    for ((i=0; i<filled_length; i++)); do
        bar="${bar}â–ˆ"
    done
    for ((i=filled_length; i<bar_length; i++)); do
        bar="${bar}â–‘"
    done
    
#    # è®¡ç®—é¢„ä¼°æ—¶é—´
    local elapsed=$(($(date +%s) - START_TIME))
    local eta="æœªçŸ¥"
    if [[ $current -gt 0 ]]; then
        local remaining_time=$(((total - current) * elapsed / current))
        eta=$(format_duration "$remaining_time")
    fi
    
#    # æ˜¾ç¤ºè¿›åº¦
    printf "\r%s: [%s] %d/%d (%d%%) ETA: %s" \
        "$prefix" "$bar" "$current" "$total" "$percentage" "$eta"
    
#    # å®Œæˆæ—¶æ¢è¡Œ
    if [[ $current -eq $total ]]; then
        echo
    fi
}

# æ—¶é—´æ ¼å¼åŒ–å‡½æ•°

format_duration() {
    local seconds="$1"
    local hours=$((seconds / 3600))
    local minutes=$(((seconds % 3600) / 60))
    local secs=$((seconds % 60))
    
    if [[ $hours -gt 0 ]]; then
        printf "%02d:%02d:%02d" "$hours" "$minutes" "$secs"
    else
        printf "%02d:%02d" "$minutes" "$secs"
    fi
}
```

### 6.2 åˆ†çº§æ—¥å¿—ç³»ç»Ÿ



**ğŸ“ å®Œå–„çš„æ—¥å¿—è®°å½•**ï¼š
```bash
# æ—¥å¿—çº§åˆ«é…ç½®

LOG_LEVEL="${LOG_LEVEL:-INFO}"
readonly LOG_LEVELS=("DEBUG" "INFO" "WARN" "ERROR" "FATAL")

# è·å–æ—¥å¿—çº§åˆ«æ•°å€¼

get_log_level_value() {
    local level="$1"
    for i in "${!LOG_LEVELS[@]}"; do
        if [[ "${LOG_LEVELS[$i]}" == "$level" ]]; then
            echo "$i"
            return
        fi
    done
    echo "1"  # é»˜è®¤INFOçº§åˆ«
}

# æ—¥å¿—è®°å½•å‡½æ•°

log_message() {
    local level="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local current_level_value=$(get_log_level_value "$LOG_LEVEL")
    local message_level_value=$(get_log_level_value "$level")
    
#    # åªè®°å½•å¤§äºç­‰äºå½“å‰æ—¥å¿—çº§åˆ«çš„æ¶ˆæ¯
    if [[ $message_level_value -ge $current_level_value ]]; then
#        # å†™å…¥æ—¥å¿—æ–‡ä»¶
        echo "[$timestamp] [$level] $message" >> "$LOG_FILE"
        
#        # æ§åˆ¶å°è¾“å‡ºï¼ˆæ ¹æ®çº§åˆ«ä½¿ç”¨ä¸åŒé¢œè‰²ï¼‰
        if [[ $VERBOSE == true ]] || [[ $message_level_value -ge 2 ]]; then
            case "$level" in
                "DEBUG")
                    echo -e "\033[0;36m[DEBUG]\033[0m $message" >&2
                    ;;
                "INFO")
                    echo -e "\033[0;32m[INFO]\033[0m $message"
                    ;;
                "WARN")
                    echo -e "\033[0;33m[WARN]\033[0m $message" >&2
                    ;;
                "ERROR")
                    echo -e "\033[0;31m[ERROR]\033[0m $message" >&2
                    ;;
                "FATAL")
                    echo -e "\033[1;31m[FATAL]\033[0m $message" >&2
                    ;;
            esac
        fi
    fi
}

# æ€§èƒ½ç›‘æ§æ—¥å¿—

log_performance() {
    local operation="$1"
    local duration="$2"
    local items_processed="${3:-1}"
    
    local rate=""
    if [[ $duration -gt 0 ]]; then
        rate=$(echo "scale=2; $items_processed / $duration" | bc -l 2>/dev/null || echo "N/A")
    fi
    
    log_message "INFO" "æ€§èƒ½ç»Ÿè®¡ - æ“ä½œ: $operation, è€—æ—¶: ${duration}s, å¤„ç†é‡: $items_processed, é€Ÿç‡: ${rate}/s"
}
```

### 6.3 æ“ä½œå®¡è®¡è¿½è¸ª



**ğŸ” å®Œæ•´çš„æ“ä½œè®°å½•**ï¼š
```bash
# å®¡è®¡æ—¥å¿—è®°å½•

audit_log() {
    local action="$1"
    local target="$2"
    local result="$3"
    local details="${4:-}"
    
    local audit_entry=$(cat << EOF
{
  "timestamp": "$(date -Iseconds)",
  "pid": "$$",
  "user": "$(whoami)",
  "action": "$action",
  "target": "$target",
  "result": "$result",
  "details": "$details"
}
EOF
)
    
    echo "$audit_entry" >> "${LOG_FILE%.*}_audit.json"
}

# å…³é”®æ“ä½œè®°å½•

record_operation() {
    local operation_type="$1"
    local file_path="$2"
    local start_time=$(date +%s)
    
#    # è®°å½•æ“ä½œå¼€å§‹
    audit_log "$operation_type" "$file_path" "STARTED" "å¼€å§‹æ—¶é—´: $(date)"
    
#    # æ‰§è¡Œå®é™…æ“ä½œ
    if perform_file_operation "$operation_type" "$file_path"; then
        local end_time=$(date +%s)
        local duration=$((end_time - start_time))
        
        audit_log "$operation_type" "$file_path" "SUCCESS" "è€—æ—¶: ${duration}ç§’"
        return 0
    else
        audit_log "$operation_type" "$file_path" "FAILED" "æ“ä½œå¤±è´¥"
        return 1
    fi
}
```

---

## 7. âœ… è„šæœ¬æ‰§è¡Œç¯å¢ƒæ£€æŸ¥



### 7.1 ç³»ç»Ÿç¯å¢ƒéªŒè¯



**ç¯å¢ƒæ£€æŸ¥å°±åƒé£è¡Œå‰æ£€æŸ¥**ï¼šç¡®ä¿æ‰€æœ‰å¿…è¦æ¡ä»¶éƒ½æ»¡è¶³ï¼Œé¿å…æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°æ„å¤–ã€‚

```bash
# ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥ä¸»å‡½æ•°

check_environment() {
    log_message "INFO" "å¼€å§‹ç¯å¢ƒæ£€æŸ¥"
    
#    # æ£€æŸ¥æ“ä½œç³»ç»Ÿ
    check_os_compatibility
    
#    # æ£€æŸ¥å¿…éœ€å‘½ä»¤
    check_required_commands
    
#    # æ£€æŸ¥ç›®å½•æƒé™
    check_directory_permissions
    
#    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    check_disk_space
    
#    # æ£€æŸ¥å†…å­˜ä½¿ç”¨
    check_memory_usage
    
    log_message "INFO" "ç¯å¢ƒæ£€æŸ¥å®Œæˆ"
}

# æ“ä½œç³»ç»Ÿå…¼å®¹æ€§æ£€æŸ¥

check_os_compatibility() {
    local os_name=$(uname -s)
    local os_version=$(uname -r)
    
    case "$os_name" in
        "Linux")
            log_message "INFO" "æ£€æµ‹åˆ° Linux ç³»ç»Ÿ: $os_version"
            ;;
        "Darwin")
            log_message "WARN" "æ£€æµ‹åˆ° macOS ç³»ç»Ÿï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½éœ€è¦è°ƒæ•´"
            ;;
        *)
            handle_error "FATAL" "ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: $os_name"
            ;;
    esac
    
#    # æ£€æŸ¥bashç‰ˆæœ¬
    if [[ ${BASH_VERSION%%.*} -lt 4 ]]; then
        handle_error "WARN" "Bashç‰ˆæœ¬è¾ƒä½: $BASH_VERSIONï¼Œå»ºè®®å‡çº§åˆ°4.0+)"
    fi
}

# å¿…éœ€å‘½ä»¤æ£€æŸ¥

check_required_commands() {
    local required_commands=("find" "sed" "awk" "grep" "sort" "uniq" "wc" "bc")
    local missing_commands=()
    
    for cmd in "${required_commands[@]}"; do
        if ! command -v "$cmd" >/dev/null 2>&1; then
            missing_commands+=("$cmd")
        fi
    done
    
    if [[ ${#missing_commands[@]} -gt 0 ]]; then
        handle_error "FATAL" "ç¼ºå°‘å¿…éœ€å‘½ä»¤: ${missing_commands[*]}"
    else
        log_message "INFO" "æ‰€æœ‰å¿…éœ€å‘½ä»¤æ£€æŸ¥é€šè¿‡"
    fi
}
```

### 7.2 æƒé™ä¸èµ„æºæ£€æŸ¥



```bash
# ç›®å½•æƒé™æ£€æŸ¥

check_directory_permissions() {
    local directories=("$INPUT_DIR" "$OUTPUT_DIR" "$(dirname "$LOG_FILE")")
    
    for dir in "${directories[@]}"; do
#        # åˆ›å»ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        if ! mkdir -p "$dir" 2>/dev/null; then
            handle_error "FATAL" "æ— æ³•åˆ›å»ºç›®å½•: $dir"
        fi
        
#        # æ£€æŸ¥è¯»å†™æƒé™
        if [[ ! -r "$dir" ]] || [[ ! -w "$dir" ]]; then
            handle_error "FATAL" "ç›®å½•æƒé™ä¸è¶³: $dir"
        fi
        
        log_message "DEBUG" "ç›®å½•æƒé™æ£€æŸ¥é€šè¿‡: $dir"
    done
}

# ç£ç›˜ç©ºé—´æ£€æŸ¥

check_disk_space() {
    local output_dir_space=$(df "$OUTPUT_DIR" | awk 'NR==2 {print $4}')
    local required_space_kb=1048576  # 1GB in KB
    
    if [[ $output_dir_space -lt $required_space_kb ]]; then
        handle_error "WARN" "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå¯ç”¨ç©ºé—´: $((output_dir_space/1024))MBï¼Œå»ºè®®è‡³å°‘1GB"
    else
        log_message "INFO" "ç£ç›˜ç©ºé—´å……è¶³: $((output_dir_space/1024))MBå¯ç”¨"
    fi
}

# å†…å­˜ä½¿ç”¨æ£€æŸ¥

check_memory_usage() {
    local total_mem=$(free -m | awk '/^Mem:/ {print $2}')
    local available_mem=$(free -m | awk '/^Mem:/ {print $7}')
    local usage_percent=$(((total_mem - available_mem) * 100 / total_mem))
    
    if [[ $usage_percent -gt 90 ]]; then
        handle_error "WARN" "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${usage_percent}%"
    else
        log_message "INFO" "å†…å­˜ä½¿ç”¨æ­£å¸¸: ${usage_percent}%"
    fi
}
```

### 7.3 ä¾èµ–æ£€æŸ¥ä¸è‡ªåŠ¨å®‰è£…



```bash
# ä¾èµ–è½¯ä»¶æ£€æŸ¥ä¸å®‰è£…

check_and_install_dependencies() {
    local dependencies=("jq:JSONå¤„ç†å·¥å…·" "parallel:å¹¶è¡Œå¤„ç†å·¥å…·" "pv:è¿›åº¦æ˜¾ç¤ºå·¥å…·")
    
    for dep_info in "${dependencies[@]}"; do
        local dep_name="${dep_info%%:*}"
        local dep_desc="${dep_info##*:}"
        
        if ! command -v "$dep_name" >/dev/null 2>&1; then
            log_message "WARN" "ç¼ºå°‘å¯é€‰ä¾èµ–: $dep_name ($dep_desc)"
            
#            # å°è¯•è‡ªåŠ¨å®‰è£…ï¼ˆå¦‚æœæœ‰æƒé™ï¼‰
            if [[ $AUTO_INSTALL_DEPS == true ]] && [[ $EUID -eq 0 ]]; then
                install_dependency "$dep_name"
            else
                log_message "INFO" "å¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…: sudo apt install $dep_name"
            fi
        else
            log_message "DEBUG" "æ‰¾åˆ°ä¾èµ–: $dep_name"
        fi
    done
}

# è‡ªåŠ¨å®‰è£…ä¾èµ–

install_dependency() {
    local package="$1"
    
    log_message "INFO" "å°è¯•è‡ªåŠ¨å®‰è£…: $package"
    
    if command -v apt-get >/dev/null 2>&1; then
        if apt-get update && apt-get install -y "$package"; then
            log_message "INFO" "æˆåŠŸå®‰è£…: $package"
        else
            log_message "WARN" "è‡ªåŠ¨å®‰è£…å¤±è´¥: $package"
        fi
    else
        log_message "WARN" "ä¸æ”¯æŒçš„åŒ…ç®¡ç†å™¨ï¼Œè¯·æ‰‹åŠ¨å®‰è£…: $package"
    fi
}
```

---

## 8. ğŸ¯ ç»“æœéªŒè¯ä¸è´¨é‡æ§åˆ¶



### 8.1 å¤šå±‚éªŒè¯ä½“ç³»



**è´¨é‡ä¿è¯ç­–ç•¥**ï¼šå°±åƒå·¥å‚çš„è´¨æ£€æµç¨‹ä¸€æ ·ï¼Œè®¾ç½®å¤šä¸ªæ£€æŸ¥ç‚¹ç¡®ä¿æœ€ç»ˆäº§å“è´¨é‡ã€‚

```bash
# ä¸»éªŒè¯å‡½æ•°

validate_results() {
    log_message "INFO" "å¼€å§‹ç»“æœéªŒè¯"
    
    local validation_passed=true
    
#    # ç¬¬ä¸€å±‚ï¼šåŸºç¡€å®Œæ•´æ€§éªŒè¯
    if ! validate_basic_completeness; then
        validation_passed=false
    fi
    
#    # ç¬¬äºŒå±‚ï¼šæ•°æ®è´¨é‡éªŒè¯
    if ! validate_data_quality; then
        validation_passed=false
    fi
    
#    # ç¬¬ä¸‰å±‚ï¼šä¸šåŠ¡é€»è¾‘éªŒè¯
    if ! validate_business_logic; then
        validation_passed=false
    fi
    
#    # ç”ŸæˆéªŒè¯æŠ¥å‘Š
    generate_validation_report
    
    if [[ $validation_passed == false ]]; then
        handle_error "ERROR" "ç»“æœéªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¤„ç†è¿‡ç¨‹"
        return 1
    else
        log_message "INFO" "æ‰€æœ‰éªŒè¯æ£€æŸ¥é€šè¿‡"
        return 0
    fi
}

# åŸºç¡€å®Œæ•´æ€§éªŒè¯

validate_basic_completeness() {
    local expected_files=0
    local actual_files=0
    local validation_errors=0
    
#    # ç»Ÿè®¡é¢„æœŸæ–‡ä»¶æ•°
    expected_files=$(find "$INPUT_DIR" -name "*.txt" -type f | wc -l)
    
#    # ç»Ÿè®¡å®é™…è¾“å‡ºæ–‡ä»¶æ•°
    actual_files=$(find "$OUTPUT_DIR" -name "*_processed.txt" -type f | wc -l)
    
    log_message "INFO" "æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥ - é¢„æœŸ: $expected_files, å®é™…: $actual_files"
    
#    # æ£€æŸ¥æ–‡ä»¶æ•°é‡åŒ¹é…
    if [[ $actual_files -ne $expected_files ]]; then
        handle_error "ERROR" "è¾“å‡ºæ–‡ä»¶æ•°é‡ä¸åŒ¹é…"
        ((validation_errors++))
    fi
    
#    # æ£€æŸ¥æ¯ä¸ªè¾“å‡ºæ–‡ä»¶
    while IFS= read -r -d '' output_file; do
        if ! validate_single_output_file "$output_file"; then
            ((validation_errors++))
        fi
    done < <(find "$OUTPUT_DIR" -name "*_processed.txt" -type f -print0)
    
    return $((validation_errors == 0))
}
```

### 8.2 æ•°æ®è´¨é‡è¯„ä¼°



```bash
# æ•°æ®è´¨é‡éªŒè¯

validate_data_quality() {
    local quality_issues=0
    
    log_message "INFO" "å¼€å§‹æ•°æ®è´¨é‡æ£€æŸ¥"
    
#    # æ£€æŸ¥æ–‡ä»¶ç¼–ç ä¸€è‡´æ€§
    check_encoding_consistency || ((quality_issues++))
    
#    # æ£€æŸ¥æ•°æ®æ ¼å¼è§„èŒƒæ€§
    check_format_compliance || ((quality_issues++))
    
#    # æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
    check_data_integrity || ((quality_issues++))
    
#    # ç»Ÿè®¡è´¨é‡æŒ‡æ ‡
    calculate_quality_metrics
    
    if [[ $quality_issues -eq 0 ]]; then
        log_message "INFO" "æ•°æ®è´¨é‡æ£€æŸ¥é€šè¿‡"
        return 0
    else
        log_message "ERROR" "å‘ç° $quality_issues ä¸ªè´¨é‡é—®é¢˜"
        return 1
    fi
}

# ç¼–ç ä¸€è‡´æ€§æ£€æŸ¥

check_encoding_consistency() {
    local encoding_issues=0
    
    while IFS= read -r -d '' file; do
        local file_encoding=$(file -bi "$file" | cut -d'=' -f2)
        
        if [[ "$file_encoding" != "utf-8" ]] && [[ "$file_encoding" != "us-ascii" ]]; then
            handle_error "WARN" "æ–‡ä»¶ç¼–ç å¼‚å¸¸: $file ($file_encoding)"
            ((encoding_issues++))
        fi
    done < <(find "$OUTPUT_DIR" -type f -name "*.txt" -print0)
    
    return $((encoding_issues == 0))
}

# æ ¼å¼åˆè§„æ€§æ£€æŸ¥

check_format_compliance() {
    local format_issues=0
    
#    # å®šä¹‰æ ¼å¼è§„åˆ™
    local max_line_length=1000
    local forbidden_chars=$'\x00-\x08\x0B\x0C\x0E-\x1F\x7F'
    
    while IFS= read -r -d '' file; do
#        # æ£€æŸ¥è¡Œé•¿åº¦
        local max_line=$(awk 'length > max {max = length} END {print max}' "$file")
        if [[ $max_line -gt $max_line_length ]]; then
            handle_error "WARN" "æ–‡ä»¶åŒ…å«è¿‡é•¿è¡Œ: $file (æœ€å¤§é•¿åº¦: $max_line)"
            ((format_issues++))
        fi
        
#        # æ£€æŸ¥éæ³•å­—ç¬¦
        if grep -qP "[$forbidden_chars]" "$file" 2>/dev/null; then
            handle_error "WARN" "æ–‡ä»¶åŒ…å«æ§åˆ¶å­—ç¬¦: $file"
            ((format_issues++))
        fi
    done < <(find "$OUTPUT_DIR" -type f -name "*.txt" -print0)
    
    return $((format_issues == 0))
}
```

### 8.3 æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡



```bash
# æ€§èƒ½ç»Ÿè®¡ä¸åˆ†æ

calculate_quality_metrics() {
    local total_input_size=0
    local total_output_size=0
    local processing_time=$(($(date +%s) - START_TIME))
    
#    # è®¡ç®—è¾“å…¥æ–‡ä»¶æ€»å¤§å°
    while IFS= read -r -d '' file; do
        local file_size=$(stat -c%s "$file")
        total_input_size=$((total_input_size + file_size))
    done < <(find "$INPUT_DIR" -type f -name "*.txt" -print0)
    
#    # è®¡ç®—è¾“å‡ºæ–‡ä»¶æ€»å¤§å°
    while IFS= read -r -d '' file; do
        local file_size=$(stat -c%s "$file")
        total_output_size=$((total_output_size + file_size))
    done < <(find "$OUTPUT_DIR" -type f -name "*.txt" -print0)
    
#    # è®¡ç®—å¤„ç†é€Ÿç‡
    local processing_rate=0
    if [[ $processing_time -gt 0 ]]; then
        processing_rate=$((total_input_size / processing_time / 1024))  # KB/s
    fi
    
#    # è®°å½•æ€§èƒ½æŒ‡æ ‡
    {
        echo "========== æ€§èƒ½ç»Ÿè®¡æŠ¥å‘Š =========="
        echo "å¤„ç†æ—¶é—´: $(format_duration $processing_time)"
        echo "è¾“å…¥æ•°æ®é‡: $(format_file_size $total_input_size)"
        echo "è¾“å‡ºæ•°æ®é‡: $(format_file_size $total_output_size)"
        echo "å¤„ç†é€Ÿç‡: ${processing_rate} KB/s"
        echo "å‹ç¼©æ¯”: $(echo "scale=2; $total_output_size * 100 / $total_input_size" | bc)%"
        echo "æ–‡ä»¶å¤„ç†æ•°: $PROCESSED_FILES"
        echo "é”™è¯¯æ•°é‡: $ERROR_COUNT"
        echo "è­¦å‘Šæ•°é‡: $WARNING_COUNT"
    } >> "${LOG_FILE%.*}_metrics.txt"
    
    log_performance "æ‰¹é‡å¤„ç†" "$processing_time" "$PROCESSED_FILES"
}

# æ–‡ä»¶å¤§å°æ ¼å¼åŒ–

format_file_size() {
    local size_bytes="$1"
    local size_kb=$((size_bytes / 1024))
    local size_mb=$((size_kb / 1024))
    
    if [[ $size_mb -gt 0 ]]; then
        echo "${size_mb}MB"
    elif [[ $size_kb -gt 0 ]]; then
        echo "${size_kb}KB"
    else
        echo "${size_bytes}B"
    fi
}
```

---

## 9. ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¨¡æ¿



### 9.1 ç”Ÿäº§ç¯å¢ƒé€‚é…



**ç”Ÿäº§ç¯å¢ƒè¦æ±‚**ï¼šç”Ÿäº§ç¯å¢ƒå°±åƒé«˜é€Ÿå…¬è·¯ï¼Œéœ€è¦æ›´é«˜çš„å®‰å…¨æ€§ã€ç¨³å®šæ€§å’Œç›‘æ§èƒ½åŠ›ã€‚

```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®

setup_production_environment() {
#    # è®¾ç½®ä¸¥æ ¼çš„å®‰å…¨é€‰é¡¹
    set -euo pipefail
    umask 022
    
#    # ç”Ÿäº§ç¯å¢ƒå˜é‡
    readonly PRODUCTION_MODE=true
    readonly MAX_PARALLEL_JOBS=8
    readonly BACKUP_RETENTION_DAYS=30
    readonly LOG_ROTATION_SIZE="100M"
    
#    # å®‰å…¨æ£€æŸ¥
    check_production_security
    
#    # é…ç½®ç›‘æ§
    setup_monitoring
    
#    # é…ç½®å‘Šè­¦
    setup_alerting
    
    log_message "INFO" "ç”Ÿäº§ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ"
}

# ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥

check_production_security() {
#    # æ£€æŸ¥è¿è¡Œç”¨æˆ·
    if [[ $EUID -eq 0 ]] && [[ $ALLOW_ROOT != true ]]; then
        handle_error "FATAL" "ç”Ÿäº§ç¯å¢ƒç¦æ­¢ä½¿ç”¨rootç”¨æˆ·è¿è¡Œ"
    fi
    
#    # æ£€æŸ¥æ–‡ä»¶æƒé™
    local script_perms=$(stat -c %a "$0")
    if [[ "$script_perms" != "755" ]] && [[ "$script_perms" != "750" ]]; then
        handle_error "WARN" "è„šæœ¬æ–‡ä»¶æƒé™å¼‚å¸¸: $script_perms"
    fi
    
#    # æ£€æŸ¥æ•æ„Ÿç›®å½•
    local sensitive_dirs=("/etc" "/var" "/usr" "/bin" "/sbin")
    for dir in "${sensitive_dirs[@]}"; do
        if [[ "$OUTPUT_DIR" == "$dir"* ]]; then
            handle_error "FATAL" "ç¦æ­¢å‘ç³»ç»Ÿç›®å½•å†™å…¥: $OUTPUT_DIR"
        fi
    done
}
```

### 9.2 ç›‘æ§ä¸å‘Šè­¦é›†æˆ



```bash
# ç›‘æ§ç³»ç»Ÿé›†æˆ

setup_monitoring() {
#    # åˆ›å»ºç›‘æ§ç›®å½•
    readonly MONITOR_DIR="/var/log/batch_processing"
    mkdir -p "$MONITOR_DIR"
    
#    # ç³»ç»Ÿèµ„æºç›‘æ§
    start_resource_monitoring &
    MONITOR_PID=$!
    
#    # æ³¨å†Œæ¸…ç†å‡½æ•°
    trap "kill $MONITOR_PID 2>/dev/null || true" EXIT
}

# èµ„æºç›‘æ§å‡½æ•°

start_resource_monitoring() {
    local monitor_interval=30  # 30ç§’ç›‘æ§é—´éš”
    
    while true; do
        {
            echo "æ—¶é—´æˆ³: $(date -Iseconds)"
            echo "CPUä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)%"
            echo "å†…å­˜ä½¿ç”¨: $(free -m | awk '/^Mem:/ {printf "%.1f%%", $3/$2 * 100}')"
            echo "ç£ç›˜ä½¿ç”¨: $(df "$OUTPUT_DIR" | awk 'NR==2 {print $5}')"
            echo "è¿›ç¨‹æ•°: $(ps aux | grep "$SCRIPT_NAME" | grep -v grep | wc -l)"
            echo "---"
        } >> "$MONITOR_DIR/resource_usage.log"
        
        sleep $monitor_interval
    done
}

# å‘Šè­¦ç³»ç»Ÿ

send_alert() {
    local alert_level="$1"
    local alert_message="$2"
    local alert_time=$(date -Iseconds)
    
#    # è®°å½•å‘Šè­¦
    {
        echo "æ—¶é—´: $alert_time"
        echo "çº§åˆ«: $alert_level"
        echo "æ¶ˆæ¯: $alert_message"
        echo "ä¸»æœº: $(hostname)"
        echo "è„šæœ¬: $SCRIPT_NAME"
        echo "---"
    } >> "$MONITOR_DIR/alerts.log"
    
#    # å‘é€é‚®ä»¶å‘Šè­¦ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
    if [[ -n "${ALERT_EMAIL:-}" ]] && command -v mail >/dev/null; then
        echo "$alert_message" | mail -s "[$alert_level] æ‰¹å¤„ç†è„šæœ¬å‘Šè­¦" "$ALERT_EMAIL"
    fi
    
#    # Webhookå‘Šè­¦ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
    if [[ -n "${WEBHOOK_URL:-}" ]]; then
        curl -X POST "$WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d "{\"level\":\"$alert_level\",\"message\":\"$alert_message\",\"timestamp\":\"$alert_time\"}" \
            >/dev/null 2>&1 || true
    fi
}
```

### 9.3 éƒ¨ç½²ä¸ç»´æŠ¤å·¥å…·



```bash
# éƒ¨ç½²è„šæœ¬

deploy_to_production() {
    local deployment_target="$1"
    local version="$2"
    
    log_message "INFO" "å¼€å§‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ: $deployment_target"
    
#    # åˆ›å»ºéƒ¨ç½²ç›®å½•
    local deploy_dir="/opt/batch_processing/$version"
    mkdir -p "$deploy_dir"
    
#    # å¤åˆ¶è„šæœ¬æ–‡ä»¶
    cp "$SCRIPT_DIR"/*.sh "$deploy_dir/"
    chmod 755 "$deploy_dir"/*.sh
    
#    # å¤åˆ¶é…ç½®æ–‡ä»¶
    if [[ -f "$SCRIPT_DIR/config.conf" ]]; then
        cp "$SCRIPT_DIR/config.conf" "$deploy_dir/"
        chmod 644 "$deploy_dir/config.conf"
    fi
    
#    # åˆ›å»ºç¬¦å·é“¾æ¥
    ln -sf "$deploy_dir/$SCRIPT_NAME" "/usr/local/bin/$SCRIPT_NAME"
    
#    # è®¾ç½®cronä»»åŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰
    setup_cron_job
    
#    # åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
    create_systemd_service
    
    log_message "INFO" "éƒ¨ç½²å®Œæˆ"
}

# å®šæ—¶ä»»åŠ¡è®¾ç½®

setup_cron_job() {
    local cron_schedule="${CRON_SCHEDULE:-0 2 * * *}"  # é»˜è®¤æ¯å¤©å‡Œæ™¨2ç‚¹
    local cron_entry="$cron_schedule /usr/local/bin/$SCRIPT_NAME -c /opt/batch_processing/config.conf"
    
#    # æ·»åŠ åˆ°crontabï¼ˆå¦‚æœå°šæœªå­˜åœ¨ï¼‰
    if ! crontab -l 2>/dev/null | grep -q "$SCRIPT_NAME"; then
        (crontab -l 2>/dev/null; echo "$cron_entry") | crontab -
        log_message "INFO" "æ·»åŠ å®šæ—¶ä»»åŠ¡: $cron_schedule"
    fi
}

# åˆ›å»ºsystemdæœåŠ¡

create_systemd_service() {
    local service_file="/etc/systemd/system/${SCRIPT_NAME%.*}.service"
    
    cat > "$service_file" << EOF
[Unit]
Description=æ‰¹é‡æ•°æ®å¤„ç†æœåŠ¡
After=network.target

[Service]
Type=oneshot
User=batchuser
Group=batchgroup
WorkingDirectory=/opt/batch_processing
ExecStart=/usr/local/bin/$SCRIPT_NAME -c /opt/batch_processing/config.conf
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

    systemctl daemon-reload
    log_message "INFO" "åˆ›å»ºsystemdæœåŠ¡: ${SCRIPT_NAME%.*}.service"
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ



```
ğŸ”¸ è„šæœ¬è‡ªåŠ¨åŒ–æœ¬è´¨ï¼šå°†é‡å¤æ€§æ‰‹åŠ¨æ“ä½œè½¬åŒ–ä¸ºå¯é‡å¤æ‰§è¡Œçš„ä»£ç 
ğŸ”¸ æ¡†æ¶åŒ–æ€ç»´ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
ğŸ”¸ å‚æ•°åŒ–é…ç½®ï¼šé€šè¿‡å‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶æä¾›çµæ´»æ€§
ğŸ”¸ é”™è¯¯å¤„ç†æœºåˆ¶ï¼šé¢„è§å¯èƒ½çš„å¤±è´¥ç‚¹ï¼Œæä¾›æ¢å¤å’Œå›æ»šèƒ½åŠ›
ğŸ”¸ è¿›åº¦åé¦ˆç³»ç»Ÿï¼šæä¾›ç”¨æˆ·å‹å¥½çš„æ‰§è¡ŒçŠ¶æ€å’Œé¢„ä¼°æ—¶é—´
ğŸ”¸ ç¯å¢ƒæ£€æŸ¥éªŒè¯ï¼šç¡®ä¿æ‰§è¡Œç¯å¢ƒæ»¡è¶³è„šæœ¬è¿è¡Œè¦æ±‚
ğŸ”¸ ç»“æœè´¨é‡æ§åˆ¶ï¼šå¤šå±‚éªŒè¯ç¡®ä¿å¤„ç†ç»“æœçš„æ­£ç¡®æ€§
ğŸ”¸ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼šè€ƒè™‘å®‰å…¨æ€§ã€ç›‘æ§æ€§å’Œå¯ç»´æŠ¤æ€§
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è„šæœ¬æ¨¡æ¿åŒ–**ï¼š
```
é—®é¢˜æ ¹æºï¼š
â€¢ é‡å¤æ€§å·¥ä½œæµªè´¹æ—¶é—´å’Œç²¾åŠ›
â€¢ æ‰‹åŠ¨æ“ä½œå®¹æ˜“å‡ºé”™ä¸”éš¾ä»¥è¿½è¸ª
â€¢ ç¼ºä¹æ ‡å‡†åŒ–æµç¨‹å½±å“æ•ˆç‡
â€¢ æ²¡æœ‰ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

è§£å†³ä»·å€¼ï¼š
â€¢ æé«˜å·¥ä½œæ•ˆç‡å’Œå‡†ç¡®æ€§
â€¢ å»ºç«‹æ ‡å‡†åŒ–çš„å¤„ç†æµç¨‹
â€¢ é™ä½äººä¸ºé”™è¯¯çš„å‘ç”Ÿæ¦‚ç‡
â€¢ ä¾¿äºç»´æŠ¤å’ŒçŸ¥è¯†ä¼ æ‰¿
```

**ğŸ”¹ å¦‚ä½•è®¾è®¡å¥å£®çš„å¤„ç†è„šæœ¬**ï¼š
```
è®¾è®¡åŸåˆ™ï¼š
1. é˜²å¾¡æ€§ç¼–ç¨‹ï¼šå‡è®¾æ‰€æœ‰å¯èƒ½çš„é”™è¯¯éƒ½ä¼šå‘ç”Ÿ
2. æ¸è¿›å¼å¤„ç†ï¼šå¯ä»¥éšæ—¶ä¸­æ–­å’Œæ¢å¤
3. å¹‚ç­‰æ€§æ“ä½œï¼šå¤šæ¬¡æ‰§è¡Œç»“æœä¸€è‡´
4. å¯è§‚æµ‹æ€§ï¼šæä¾›å……åˆ†çš„æ—¥å¿—å’Œç›‘æ§ä¿¡æ¯

æ ¸å¿ƒè¦ç´ ï¼š
â€¢ è¾“å…¥éªŒè¯ï¼šç¡®ä¿è¾“å…¥æ•°æ®çš„å®Œæ•´æ€§å’Œåˆæ³•æ€§
â€¢ çŠ¶æ€ç®¡ç†ï¼šç»´æŠ¤å¤„ç†è¿›åº¦å’Œä¸­é—´çŠ¶æ€
â€¢ é”™è¯¯å¤„ç†ï¼šæä¾›å¤šå±‚æ¬¡çš„é”™è¯¯æ£€æµ‹å’Œæ¢å¤
â€¢ èµ„æºç®¡ç†ï¼šåˆç†ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼Œé¿å…è¿‡è½½
```

**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒçš„ç‰¹æ®Šè€ƒè™‘**ï¼š
```
å®‰å…¨æ€§è¦æ±‚ï¼š
â€¢ æƒé™æœ€å°åŒ–ï¼šåªç»™äºˆå¿…è¦çš„ç³»ç»Ÿæƒé™
â€¢ è¾“å…¥è¿‡æ»¤ï¼šä¸¥æ ¼éªŒè¯æ‰€æœ‰å¤–éƒ¨è¾“å…¥
â€¢ å®¡è®¡è·Ÿè¸ªï¼šè®°å½•æ‰€æœ‰å…³é”®æ“ä½œ

å¯é æ€§è¦æ±‚ï¼š
â€¢ æ•…éšœæ¢å¤ï¼šå¿«é€Ÿä»é”™è¯¯çŠ¶æ€æ¢å¤
â€¢ æ•°æ®å®Œæ•´æ€§ï¼šç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±æˆ–æŸå
â€¢ æ€§èƒ½ç›‘æ§ï¼šå®æ—¶ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

å¯ç»´æŠ¤æ€§è¦æ±‚ï¼š
â€¢ ç‰ˆæœ¬ç®¡ç†ï¼šæ”¯æŒç‰ˆæœ¬å›æ»šå’Œå‡çº§
â€¢ é…ç½®ç®¡ç†ï¼šç¯å¢ƒç›¸å…³é…ç½®å¤–éƒ¨åŒ–
â€¢ æ–‡æ¡£å®Œæ•´ï¼šæä¾›è¯¦ç»†çš„ä½¿ç”¨å’Œç»´æŠ¤æ–‡æ¡£
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼



**ğŸ’¼ æ—¥å¸¸ä½¿ç”¨å»ºè®®**ï¼š
```
å¼€å‘é˜¶æ®µï¼š
1. ä»ç®€å•æ¨¡æ¿å¼€å§‹ï¼Œé€æ­¥å¢åŠ åŠŸèƒ½
2. é‡è§†é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
3. å……åˆ†æµ‹è¯•å„ç§å¼‚å¸¸æƒ…å†µ
4. ç¼–å†™æ¸…æ™°çš„ä½¿ç”¨æ–‡æ¡£

éƒ¨ç½²é˜¶æ®µï¼š
1. åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
2. åˆ¶å®šè¯¦ç»†çš„éƒ¨ç½²è®¡åˆ’
3. å‡†å¤‡å›æ»šæ–¹æ¡ˆ
4. é…ç½®ç›‘æ§å’Œå‘Šè­¦

ç»´æŠ¤é˜¶æ®µï¼š
1. å®šæœŸæ£€æŸ¥æ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡
2. åŠæ—¶æ›´æ–°å’Œä¼˜åŒ–è„šæœ¬
3. æ”¶é›†ç”¨æˆ·åé¦ˆæ”¹è¿›åŠŸèƒ½
4. ä¿æŒæ–‡æ¡£çš„æ—¶æ•ˆæ€§
```

**ğŸ› ï¸ æœ€ä½³å®è·µæ€»ç»“**ï¼š
```
ä»£ç è´¨é‡ï¼š
â€¢ ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å’Œå‡½æ•°å
â€¢ æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œè¯´æ˜
â€¢ ä¿æŒä»£ç ç»“æ„æ¸…æ™°ç®€æ´
â€¢ éµå¾ªshellç¼–ç¨‹è§„èŒƒ

é”™è¯¯å¤„ç†ï¼š
â€¢ ä½¿ç”¨set -euo pipefailå¢å¼ºå®‰å…¨æ€§
â€¢ ä¸ºæ¯ä¸ªå…³é”®æ“ä½œæ·»åŠ é”™è¯¯æ£€æŸ¥
â€¢ æä¾›æœ‰ç”¨çš„é”™è¯¯æ¶ˆæ¯
â€¢ å®ç°ä¼˜é›…çš„é”™è¯¯æ¢å¤

æ€§èƒ½ä¼˜åŒ–ï¼š
â€¢ åˆç†ä½¿ç”¨å¹¶è¡Œå¤„ç†
â€¢ é¿å…ä¸å¿…è¦çš„é‡å¤æ“ä½œ
â€¢ ä¼˜åŒ–ç£ç›˜I/Oæ“ä½œ
â€¢ ç›‘æ§å†…å­˜å’ŒCPUä½¿ç”¨æƒ…å†µ

å®‰å…¨è€ƒè™‘ï¼š
â€¢ éªŒè¯æ‰€æœ‰å¤–éƒ¨è¾“å…¥
â€¢ ä½¿ç”¨åˆé€‚çš„æ–‡ä»¶æƒé™
â€¢ é¿å…åœ¨æ—¥å¿—ä¸­è®°å½•æ•æ„Ÿä¿¡æ¯
â€¢ å®šæœŸæ›´æ–°ä¾èµ–çš„å·¥å…·å’Œåº“
```

### 10.4 å­¦ä¹ è·¯å¾„å»ºè®®



**ğŸ¯ å­¦ä¹ é˜¶æ®µè§„åˆ’**ï¼š
```
é˜¶æ®µä¸€ï¼šåŸºç¡€æŒæ¡ï¼ˆ1-2å‘¨ï¼‰
â€¢ ç†è§£è„šæœ¬è‡ªåŠ¨åŒ–çš„åŸºæœ¬æ¦‚å¿µ
â€¢ å­¦ä¼šåŸºæœ¬çš„å‚æ•°å¤„ç†å’Œé”™è¯¯å¤„ç†
â€¢ èƒ½å¤Ÿç¼–å†™ç®€å•çš„æ‰¹å¤„ç†è„šæœ¬
â€¢ æŒæ¡æ—¥å¿—è®°å½•å’Œè¿›åº¦æ˜¾ç¤º

é˜¶æ®µäºŒï¼šè¿›é˜¶åº”ç”¨ï¼ˆ2-4å‘¨ï¼‰
â€¢ æŒæ¡å¹¶è¡Œå¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–
â€¢ å­¦ä¼šå®ç°å›æ»šå’Œæ¢å¤æœºåˆ¶
â€¢ èƒ½å¤Ÿè¿›è¡Œç»“æœéªŒè¯å’Œè´¨é‡æ§åˆ¶
â€¢ äº†è§£ç›‘æ§å’Œå‘Šè­¦çš„é›†æˆ

é˜¶æ®µä¸‰ï¼šç”Ÿäº§å®è·µï¼ˆ1-2ä¸ªæœˆï¼‰
â€¢ èƒ½å¤Ÿè®¾è®¡å¤æ‚çš„å¤„ç†æµç¨‹
â€¢ æŒæ¡ç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²å’Œç»´æŠ¤
â€¢ å…·å¤‡æ•…éšœæ’æŸ¥å’Œæ€§èƒ½è°ƒä¼˜èƒ½åŠ›
â€¢ èƒ½å¤Ÿåˆ¶å®šæ ‡å‡†åŒ–çš„æ“ä½œè§„ç¨‹
```

### 10.5 å¸¸è§é—®é¢˜è§£ç­”



**â“ è„šæœ¬æ‰§è¡Œå¾ˆæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ**
```
ç­”ï¼šæ€§èƒ½ä¼˜åŒ–ç­–ç•¥
â€¢ åˆ†æç“¶é¢ˆï¼šä½¿ç”¨profilingå·¥å…·æ‰¾å‡ºæ…¢çš„æ“ä½œ
â€¢ å¹¶è¡Œå¤„ç†ï¼šåˆç†ä½¿ç”¨å¤šè¿›ç¨‹å¤„ç†æ–‡ä»¶
â€¢ I/Oä¼˜åŒ–ï¼šå‡å°‘ç£ç›˜è¯»å†™æ¬¡æ•°ï¼Œæ‰¹é‡æ“ä½œ
â€¢ ç®—æ³•ä¼˜åŒ–ï¼šé€‰æ‹©æ›´é«˜æ•ˆçš„æ–‡æœ¬å¤„ç†å·¥å…·
```

**â“ å¦‚ä½•å¤„ç†è¶…å¤§æ–‡ä»¶ï¼Ÿ**
```
ç­”ï¼šå¤§æ–‡ä»¶å¤„ç†ç­–ç•¥
â€¢ æµå¼å¤„ç†ï¼šä½¿ç”¨ç®¡é“é¿å…è½½å…¥æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜
â€¢ åˆ†å—å¤„ç†ï¼šå°†å¤§æ–‡ä»¶åˆ‡åˆ†æˆå°å—é€ä¸ªå¤„ç†
â€¢ ç´¢å¼•ä¼˜åŒ–ï¼šä¸ºé¢‘ç¹æŸ¥è¯¢çš„æ•°æ®å»ºç«‹ç´¢å¼•
â€¢ å¢é‡å¤„ç†ï¼šåªå¤„ç†å˜åŒ–çš„éƒ¨åˆ†
```

**â“ è„šæœ¬åœ¨ä¸åŒç¯å¢ƒä¸‹è¡¨ç°ä¸ä¸€è‡´ï¼Ÿ**
```
ç­”ï¼šç¯å¢ƒä¸€è‡´æ€§ä¿è¯
â€¢ ç¯å¢ƒæ£€æŸ¥ï¼šå¢å¼ºç¯å¢ƒå…¼å®¹æ€§æ£€æŸ¥
â€¢ å®¹å™¨åŒ–ï¼šä½¿ç”¨Dockerç­‰å®¹å™¨æŠ€æœ¯
â€¢ ä¾èµ–ç®¡ç†ï¼šæ˜ç¡®åˆ—å‡ºæ‰€æœ‰å¤–éƒ¨ä¾èµ–
â€¢ é…ç½®å¤–éƒ¨åŒ–ï¼šç¯å¢ƒç‰¹å®šé…ç½®æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­
```

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- è‡ªåŠ¨åŒ–è„šæœ¬è¦åƒç‘å£«å†›åˆ€ï¼šåŠŸèƒ½å…¨é¢ã€ä½¿ç”¨çµæ´»ã€è´¨é‡å¯é 
- é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶æ˜¯è„šæœ¬å¥å£®æ€§çš„åŸºçŸ³
- ç”¨æˆ·ä½“éªŒåŒæ ·é‡è¦ï¼šæ¸…æ™°çš„è¿›åº¦åé¦ˆå’Œå‹å¥½çš„é”™è¯¯æç¤º
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éœ€è¦è€ƒè™‘å®‰å…¨æ€§ã€ç›‘æ§æ€§å’Œå¯ç»´æŠ¤æ€§
- æ¨¡æ¿åŒ–è®¾è®¡æé«˜å¤ç”¨æ€§ï¼Œæ ‡å‡†åŒ–æµç¨‹ä¿è¯è´¨é‡

**æ ¸å¿ƒç†å¿µ**ï¼šä¼˜ç§€çš„è‡ªåŠ¨åŒ–è„šæœ¬ä¸ä»…èƒ½å®Œæˆä»»åŠ¡ï¼Œæ›´è¦èƒ½ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸ï¼Œæä¾›æ¸…æ™°çš„åé¦ˆï¼Œå¹¶ä¸”æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚é€šè¿‡æ ‡å‡†åŒ–çš„è„šæœ¬æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ„å»ºé«˜è´¨é‡çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼Œè®©ç¹é‡çš„æ•°æ®å¤„ç†å·¥ä½œå˜å¾—è½»æ¾é«˜æ•ˆï¼

---

# ğŸ¯ å¿«é€Ÿä¸Šæ‰‹æŒ‡å—



## æœ€å°å¯ç”¨ç¤ºä¾‹


æƒ³è¦å¿«é€Ÿä¸Šæ‰‹ï¼Ÿè¿™é‡Œæ˜¯ä¸€ä¸ªæœ€ç®€åŒ–çš„æ¨¡æ¿ï¼š

```bash
#!/bin/bash

set -euo pipefail

# åŸºç¡€é…ç½®

SCRIPT_NAME=$(basename "$0")
LOG_FILE="/tmp/${SCRIPT_NAME%.*}_$(date +%Y%m%d_%H%M%S).log"

# æ—¥å¿—å‡½æ•°

log() { echo "$(date '+%Y-%m-%d %H:%M:%S') [$1] $2" | tee -a "$LOG_FILE"; }

# ä¸»å¤„ç†å‡½æ•°

process_files() {
    local input_dir="${1:-./input}"
    local count=0
    
    for file in "$input_dir"/*.txt; do
        [[ -f "$file" ]] || continue
        
        log "INFO" "å¤„ç†æ–‡ä»¶: $(basename "$file")"
        
#        # ä½ çš„å¤„ç†é€»è¾‘å†™åœ¨è¿™é‡Œ
        sed 's/old/new/g' "$file" > "${file%.txt}_processed.txt"
        
        ((count++))
    done
    
    log "INFO" "å®Œæˆï¼å…±å¤„ç† $count ä¸ªæ–‡ä»¶"
}

# ä¸»å‡½æ•°

main() {
    log "INFO" "å¼€å§‹æ‰§è¡Œ $SCRIPT_NAME"
    process_files "$@"
    log "INFO" "æ‰§è¡Œå®Œæˆ"
}

# è„šæœ¬å…¥å£

main "$@"
```

## ä½¿ç”¨æ­¥éª¤


1. **å¤åˆ¶æ¨¡æ¿**ï¼šé€‰æ‹©åˆé€‚çš„å¤æ‚åº¦çº§åˆ«
2. **ä¿®æ”¹é€»è¾‘**ï¼šæ›¿æ¢æ ¸å¿ƒå¤„ç†éƒ¨åˆ†
3. **æµ‹è¯•éªŒè¯**ï¼šå°è§„æ¨¡æ•°æ®æµ‹è¯•
4. **ç”Ÿäº§éƒ¨ç½²**ï¼šæ·»åŠ ç›‘æ§å’Œå‘Šè­¦

è®°ä½ï¼šä»ç®€å•å¼€å§‹ï¼Œé€æ­¥å®Œå–„ã€‚å¥½çš„è‡ªåŠ¨åŒ–è„šæœ¬æ˜¯è¿­ä»£å‡ºæ¥çš„ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å®Œç¾è®¾è®¡å‡ºæ¥çš„ï¼