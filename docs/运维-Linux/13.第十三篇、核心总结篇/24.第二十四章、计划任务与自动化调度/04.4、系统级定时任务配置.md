---
title: 4ã€ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡é…ç½®
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡æ¦‚è¿°](#1-ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡æ¦‚è¿°)
2. [/etc/crontabç³»ç»Ÿé…ç½®æ–‡ä»¶](#2-etccrontabç³»ç»Ÿé…ç½®æ–‡ä»¶)
3. [/etc/cron.d/ç›®å½•ä»»åŠ¡ç®¡ç†](#3-etccrondç›®å½•ä»»åŠ¡ç®¡ç†)
4. [é¢„è®¾æ—¶é—´ç›®å½•ç³»ç»Ÿ](#4-é¢„è®¾æ—¶é—´ç›®å½•ç³»ç»Ÿ)
5. [run-partså‘½ä»¤æ‰§è¡Œæœºåˆ¶](#5-run-partså‘½ä»¤æ‰§è¡Œæœºåˆ¶)
6. [ç³»ç»Ÿä»»åŠ¡ç”¨æˆ·æƒé™ç®¡ç†](#6-ç³»ç»Ÿä»»åŠ¡ç”¨æˆ·æƒé™ç®¡ç†)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡


**ç®€å•ç†è§£**ï¼šç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡å°±æ˜¯ç”±Linuxç³»ç»Ÿç®¡ç†å‘˜è®¾ç½®çš„ã€åœ¨ç³»ç»Ÿå±‚é¢è‡ªåŠ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡é€šå¸¸ç”¨äºç³»ç»Ÿç»´æŠ¤ã€å¤‡ä»½ã€æ¸…ç†ç­‰å·¥ä½œã€‚

```
ä¸ªäººä»»åŠ¡ vs ç³»ç»Ÿä»»åŠ¡å¯¹æ¯”ï¼š

ä¸ªäººä»»åŠ¡ï¼ˆcrontab -eï¼‰ï¼š
ç”¨æˆ·: john     ä»»åŠ¡: å¤‡ä»½ä¸ªäººæ–‡æ¡£
æ‰§è¡Œè€…: john   æƒé™: ç”¨æˆ·æƒé™

ç³»ç»Ÿä»»åŠ¡ï¼ˆ/etc/crontabï¼‰ï¼š
ç”¨æˆ·: root     ä»»åŠ¡: æ¸…ç†ç³»ç»Ÿæ—¥å¿—
æ‰§è¡Œè€…: root   æƒé™: ç®¡ç†å‘˜æƒé™
```

### 1.2 ç³»ç»Ÿä»»åŠ¡çš„ç‰¹ç‚¹


**ğŸ”¸ ç®¡ç†æƒé™æ›´é«˜**
- é€šå¸¸ä»¥`root`ç”¨æˆ·èº«ä»½è¿è¡Œ
- å¯ä»¥è®¿é—®ç³»ç»Ÿæ‰€æœ‰èµ„æº
- èƒ½å¤Ÿæ‰§è¡Œç³»ç»Ÿç»´æŠ¤æ“ä½œ

**ğŸ”¸ ç®¡ç†æ–¹å¼æ›´çµæ´»**
- å¯ä»¥æŒ‡å®šä»»åŠ¡æ‰§è¡Œçš„ç”¨æˆ·èº«ä»½
- æ”¯æŒå¤šç§é…ç½®æ–‡ä»¶æ ¼å¼
- ä¾¿äºæ‰¹é‡ç®¡ç†å’Œéƒ¨ç½²

**ğŸ”¸ ç”¨é€”æ›´åŠ å¹¿æ³›**
- ç³»ç»Ÿç»´æŠ¤ï¼šæ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€è½®è½¬æ—¥å¿—
- å®‰å…¨ç®¡ç†ï¼šç³»ç»Ÿå¤‡ä»½ã€ç—…æ¯’æ‰«æ
- æ€§èƒ½ç›‘æ§ï¼šèµ„æºä½¿ç”¨ç»Ÿè®¡ã€æ€§èƒ½æŠ¥å‘Š

---

## 2. ğŸ“„ /etc/crontabç³»ç»Ÿé…ç½®æ–‡ä»¶


### 2.1 /etc/crontabæ–‡ä»¶çš„ä½œç”¨


**æ ¸å¿ƒä½œç”¨**ï¼šè¿™æ˜¯Linuxç³»ç»Ÿçš„**ä¸»è¦å®šæ—¶ä»»åŠ¡é…ç½®æ–‡ä»¶**ï¼Œç”±ç³»ç»Ÿç®¡ç†å‘˜ç›´æ¥ç¼–è¾‘ï¼Œç”¨äºè®¾ç½®ç³»ç»Ÿçº§çš„å®šæ—¶ä»»åŠ¡ã€‚

```
æ–‡ä»¶ä½ç½®å’Œæƒé™ï¼š
ä½ç½®: /etc/crontab
æƒé™: åªæœ‰rootç”¨æˆ·å¯ä»¥ä¿®æ”¹
ä½œç”¨: ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡çš„æ€»é…ç½®æ–‡ä»¶
```

### 2.2 /etc/crontabæ–‡ä»¶æ ¼å¼è¯¦è§£


**æ ‡å‡†æ ¼å¼**ï¼šæ¯”æ™®é€šç”¨æˆ·crontabå¤šäº†ä¸€ä¸ª**ç”¨æˆ·å**å­—æ®µ

```bash
# /etc/crontabæ–‡ä»¶ç¤ºä¾‹
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# åˆ† æ—¶ æ—¥ æœˆ å‘¨ ç”¨æˆ·å å‘½ä»¤
17 * * * * root cd / && run-parts --report /etc/cron.hourly
25 6 * * * root test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
```

**å­—æ®µè¯´æ˜**ï¼š

| ä½ç½® | å­—æ®µå«ä¹‰ | å–å€¼èŒƒå›´ | ç¤ºä¾‹ |
|------|---------|---------|------|
| 1 | åˆ†é’Ÿ | 0-59 | `30` è¡¨ç¤º30åˆ† |
| 2 | å°æ—¶ | 0-23 | `14` è¡¨ç¤ºä¸‹åˆ2ç‚¹ |
| 3 | æ—¥æœŸ | 1-31 | `15` è¡¨ç¤ºæ¯æœˆ15å· |
| 4 | æœˆä»½ | 1-12 | `3` è¡¨ç¤º3æœˆä»½ |
| 5 | æ˜ŸæœŸ | 0-7 | `1` è¡¨ç¤ºå‘¨ä¸€ |
| 6 | **ç”¨æˆ·å** | ç³»ç»Ÿç”¨æˆ· | `root` æˆ–å…¶ä»–ç”¨æˆ· |
| 7 | å‘½ä»¤ | shellå‘½ä»¤ | `/usr/bin/find /tmp -type f -delete` |

### 2.3 ç¯å¢ƒå˜é‡é…ç½®


**é‡è¦ç¯å¢ƒå˜é‡**ï¼š

```bash
# Shellè§£é‡Šå™¨è®¾ç½®
SHELL=/bin/bash
# ç³»ç»ŸPATHè·¯å¾„
PATH=/sbin:/bin:/usr/sbin:/usr/bin
# é‚®ä»¶é€šçŸ¥æ¥æ”¶è€…
MAILTO=root
# ä¸»ç›®å½•è®¾ç½®
HOME=/
```

**ğŸ’¡ å°è´´å£«**ï¼š`PATH`å˜é‡å¾ˆé‡è¦ï¼Œå› ä¸ºå®šæ—¶ä»»åŠ¡è¿è¡Œæ—¶å¯èƒ½æ‰¾ä¸åˆ°å‘½ä»¤çš„å®Œæ•´è·¯å¾„ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šã€‚

### 2.4 å®é™…é…ç½®ç¤ºä¾‹


```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œç³»ç»Ÿå¤‡ä»½
0 2 * * * root /usr/local/bin/backup-system.sh

# æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ¸…ç†æ—¥å¿—æ–‡ä»¶
0 3 * * 0 root /usr/sbin/logrotate /etc/logrotate.conf

# æ¯å°æ—¶æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
0 * * * * root /usr/bin/df -h > /var/log/disk-usage.log

# æ¯å¤©ä¸Šåˆ9ç‚¹å‘é€ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š
0 9 * * * root /usr/local/bin/system-report.sh | mail -s "Daily Report" admin@company.com
```

---

## 3. ğŸ“ /etc/cron.d/ç›®å½•ä»»åŠ¡ç®¡ç†


### 3.1 ä»€ä¹ˆæ˜¯/etc/cron.d/ç›®å½•


**ç®€å•ç†è§£**ï¼š`/etc/cron.d/`æ˜¯ä¸€ä¸ªä¸“é—¨å­˜æ”¾**ç‹¬ç«‹å®šæ—¶ä»»åŠ¡æ–‡ä»¶**çš„ç›®å½•ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½å¯ä»¥åŒ…å«å¤šä¸ªå®šæ—¶ä»»åŠ¡ã€‚

```
ç›®å½•ç»“æ„ç¤ºä¾‹ï¼š
/etc/cron.d/
â”œâ”€â”€ php-cleanup        â† PHPç›¸å…³æ¸…ç†ä»»åŠ¡
â”œâ”€â”€ mysql-backup       â† æ•°æ®åº“å¤‡ä»½ä»»åŠ¡  
â”œâ”€â”€ web-monitor        â† ç½‘ç«™ç›‘æ§ä»»åŠ¡
â””â”€â”€ security-scan      â† å®‰å…¨æ‰«æä»»åŠ¡
```

### 3.2 /etc/cron.d/çš„ä¼˜åŠ¿


**ğŸ”¸ æ¨¡å—åŒ–ç®¡ç†**
```
ä¼ ç»Ÿæ–¹å¼: æ‰€æœ‰ä»»åŠ¡å†™åœ¨/etc/crontabä¸­ï¼Œéš¾ä»¥ç®¡ç†
æ¨¡å—åŒ–æ–¹å¼: æŒ‰åŠŸèƒ½åˆ†ç±»åˆ›å»ºä¸åŒæ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤
```

**ğŸ”¸ ä¾¿äºç‰ˆæœ¬æ§åˆ¶**
```bash
# å¯ä»¥å°†å•ä¸ªä»»åŠ¡æ–‡ä»¶åŠ å…¥ç‰ˆæœ¬æ§åˆ¶
git add /etc/cron.d/mysql-backup
git commit -m "æ·»åŠ æ•°æ®åº“å¤‡ä»½ä»»åŠ¡"
```

**ğŸ”¸ æƒé™éš”ç¦»**
- ä¸åŒçš„ä»»åŠ¡æ–‡ä»¶å¯ä»¥è®¾ç½®ä¸åŒçš„æƒé™
- ä¾¿äºå›¢é˜Ÿåä½œå’Œæƒé™ç®¡ç†

### 3.3 /etc/cron.d/æ–‡ä»¶æ ¼å¼


**æ ¼å¼è¦æ±‚**ï¼šä¸`/etc/crontab`å®Œå…¨ç›¸åŒï¼Œå¿…é¡»åŒ…å«ç”¨æˆ·åå­—æ®µ

```bash
# /etc/cron.d/mysql-backupæ–‡ä»¶ç¤ºä¾‹
SHELL=/bin/bash
PATH=/usr/local/bin:/usr/bin:/bin

# æ¯å¤©å‡Œæ™¨1ç‚¹30åˆ†å¤‡ä»½æ•°æ®åº“
30 1 * * * mysql mysqldump --all-databases > /backup/mysql-$(date +\%Y\%m\%d).sql

# æ¯å‘¨ä¸€å‡Œæ™¨åˆ é™¤7å¤©å‰çš„å¤‡ä»½æ–‡ä»¶
0 2 * * 1 root find /backup -name "mysql-*.sql" -mtime +7 -delete
```

### 3.4 æ–‡ä»¶åˆ›å»ºå’Œç®¡ç†


**åˆ›å»ºæ–°ä»»åŠ¡æ–‡ä»¶**ï¼š
```bash
# åˆ›å»ºæ–°çš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶
sudo vim /etc/cron.d/web-monitor

# æ–‡ä»¶å†…å®¹
*/5 * * * * nginx /usr/local/bin/check-website.sh
0 */4 * * * www-data /usr/local/bin/clear-cache.sh
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- æ–‡ä»¶æƒé™å¿…é¡»æ˜¯`644`æˆ–æ›´ä¸¥æ ¼
- æ–‡ä»¶åä¸èƒ½åŒ…å«`.`(ç‚¹å·)
- æ–‡ä»¶å¿…é¡»ä»¥æ¢è¡Œç¬¦ç»“æŸ

---

## 4. â° é¢„è®¾æ—¶é—´ç›®å½•ç³»ç»Ÿ


### 4.1 é¢„è®¾æ—¶é—´ç›®å½•æ¦‚è¿°


**è®¾è®¡ç†å¿µ**ï¼šLinuxç³»ç»Ÿæä¾›äº†å‡ ä¸ª**é¢„è®¾çš„æ—¶é—´ç›®å½•**ï¼Œè®©ç³»ç»Ÿç®¡ç†å‘˜åªéœ€è¦æŠŠè„šæœ¬æ”¾å…¥å¯¹åº”ç›®å½•ï¼Œå°±èƒ½æŒ‰ç…§å›ºå®šæ—¶é—´é—´éš”è‡ªåŠ¨æ‰§è¡Œã€‚

```
é¢„è®¾æ—¶é—´ç›®å½•ä½“ç³»ï¼š
/etc/
â”œâ”€â”€ cron.hourly/    â† æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
â”œâ”€â”€ cron.daily/     â† æ¯å¤©æ‰§è¡Œä¸€æ¬¡  
â”œâ”€â”€ cron.weekly/    â† æ¯å‘¨æ‰§è¡Œä¸€æ¬¡
â””â”€â”€ cron.monthly/   â† æ¯æœˆæ‰§è¡Œä¸€æ¬¡
```

### 4.2 å„ç›®å½•è¯¦ç»†è¯´æ˜


#### ğŸ“‚ /etc/cron.hourlyç›®å½•


**æ‰§è¡Œæ—¶é—´**ï¼šæ¯å°æ—¶çš„ç¬¬17åˆ†é’Ÿæ‰§è¡Œ
**é€‚ç”¨åœºæ™¯**ï¼šé¢‘ç¹çš„ç³»ç»Ÿæ£€æŸ¥ã€æ—¥å¿—æ”¶é›†

```bash
# æŸ¥çœ‹ç›®å½•å†…å®¹
ls -la /etc/cron.hourly/
# å…¸å‹è¾“å‡ºï¼š
-rwxr-xr-x 1 root root  392 Mar 15 10:30 0anacron
-rwxr-xr-x 1 root root  214 Apr  1 12:15 logcheck
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºæ¯å°æ—¶æ£€æŸ¥ç£ç›˜ç©ºé—´çš„è„šæœ¬
sudo vim /etc/cron.hourly/disk-check

#!/bin/bash
USAGE=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')
if [ $USAGE -gt 90 ]; then
    echo "ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡90%: ${USAGE}%" | mail -s "ç£ç›˜è­¦å‘Š" admin@company.com
fi

# è®¾ç½®æ‰§è¡Œæƒé™
sudo chmod +x /etc/cron.hourly/disk-check
```

#### ğŸ“‚ /etc/cron.dailyç›®å½•


**æ‰§è¡Œæ—¶é—´**ï¼šæ¯å¤©å‡Œæ™¨6ç‚¹25åˆ†æ‰§è¡Œ
**é€‚ç”¨åœºæ™¯**ï¼šæ—¥å¸¸ç»´æŠ¤ä»»åŠ¡ã€æ•°æ®å¤‡ä»½ã€æ—¥å¿—æ¸…ç†

```bash
# å¸¸è§çš„dailyä»»åŠ¡
ls /etc/cron.daily/
# å…¸å‹è¾“å‡ºï¼š
0anacron  apt  aptitude  bsdmainutils  dpkg  locate  man-db
```

**åˆ›å»ºè‡ªå®šä¹‰dailyä»»åŠ¡**ï¼š
```bash
# åˆ›å»ºæ¯æ—¥å¤‡ä»½è„šæœ¬
sudo vim /etc/cron.daily/backup-important

#!/bin/bash
# å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶
tar -czf "/backup/config-$(date +%Y%m%d).tar.gz" /etc/nginx/ /etc/mysql/ /etc/php/

# åªä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find /backup -name "config-*.tar.gz" -mtime +7 -delete
```

#### ğŸ“‚ /etc/cron.weeklyç›®å½•


**æ‰§è¡Œæ—¶é—´**ï¼šæ¯å‘¨æ—¥å‡Œæ™¨6ç‚¹47åˆ†æ‰§è¡Œ
**é€‚ç”¨åœºæ™¯**ï¼šç³»ç»Ÿä¼˜åŒ–ã€å…¨é¢æ‰«æã€å‘¨æŠ¥ç”Ÿæˆ

#### ğŸ“‚ /etc/cron.monthlyç›®å½•


**æ‰§è¡Œæ—¶é—´**ï¼šæ¯æœˆ1å·å‡Œæ™¨6ç‚¹52åˆ†æ‰§è¡Œ
**é€‚ç”¨åœºæ™¯**ï¼šæœˆåº¦æŠ¥è¡¨ã€å¤§å‹æ•°æ®æ•´ç†ã€ç³»ç»Ÿæ›´æ–°

### 4.3 é¢„è®¾æ—¶é—´çš„å¥½å¤„


```
ä¼˜åŠ¿å¯¹æ¯”ï¼š

ä¼ ç»Ÿcrontabæ–¹å¼ï¼š
25 6 * * * root /usr/local/bin/daily-backup.sh
47 6 * * 0 root /usr/local/bin/weekly-report.sh
52 6 1 * * root /usr/local/bin/monthly-cleanup.sh

é¢„è®¾ç›®å½•æ–¹å¼ï¼š
åªéœ€è¦å°†è„šæœ¬æ”¾å…¥å¯¹åº”ç›®å½•å³å¯ï¼
/etc/cron.daily/daily-backup.sh
/etc/cron.weekly/weekly-report.sh  
/etc/cron.monthly/monthly-cleanup.sh
```

**ğŸ† ä¸»è¦ä¼˜åŠ¿**ï¼š
- **ç®€å•æ˜“ç”¨**ï¼šæ— éœ€ç¼–å†™cronè¡¨è¾¾å¼
- **æ ‡å‡†åŒ–**ï¼šæ‰€æœ‰ç³»ç»Ÿä½¿ç”¨ç»Ÿä¸€çš„æ‰§è¡Œæ—¶é—´
- **æ˜“äºç®¡ç†**ï¼šè„šæœ¬æ–‡ä»¶ç›´è§‚å¯è§
- **è‡ªåŠ¨æ‰§è¡Œ**ï¼šæ”¾å…¥ç›®å½•åç«‹å³ç”Ÿæ•ˆ

---

## 5. âš™ï¸ run-partså‘½ä»¤æ‰§è¡Œæœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯run-partså‘½ä»¤


**ç®€å•ç†è§£**ï¼š`run-parts`æ˜¯Linuxç³»ç»Ÿçš„ä¸€ä¸ª**æ‰¹é‡æ‰§è¡Œå·¥å…·**ï¼Œä¸“é—¨ç”¨æ¥è¿è¡ŒæŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰å¯æ‰§è¡Œè„šæœ¬ã€‚

```
å·¥ä½œåŸç†ï¼š
ç›®å½•: /etc/cron.daily/
â”œâ”€â”€ script1.sh  â† å¯æ‰§è¡Œ
â”œâ”€â”€ script2.sh  â† å¯æ‰§è¡Œ  
â”œâ”€â”€ readme.txt  â† ä¸å¯æ‰§è¡Œ(è·³è¿‡)
â””â”€â”€ backup     â† å¯æ‰§è¡Œ

run-parts /etc/cron.daily/
# ç»“æœï¼šæŒ‰å­—æ¯é¡ºåºæ‰§è¡Œscript1.shã€script2.shã€backup
```

### 5.2 run-partsçš„æ‰§è¡Œè§„åˆ™


**æ–‡ä»¶åè§„åˆ™**ï¼š
```
âœ… å…è®¸çš„æ–‡ä»¶åæ ¼å¼ï¼š
- å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦
- ç¤ºä¾‹ï¼šbackup_mysqlã€01-cleanupã€system-check

âŒ ä¸å…è®¸çš„æ–‡ä»¶åï¼š
- åŒ…å«ç‚¹å·ï¼šscript.sh (ä¼šè¢«è·³è¿‡)
- ç‰¹æ®Šå­—ç¬¦ï¼šscript@homeã€script#1
```

**æƒé™è¦æ±‚**ï¼š
- æ–‡ä»¶å¿…é¡»æœ‰**å¯æ‰§è¡Œæƒé™**(`+x`)
- æ–‡ä»¶æ‰€æœ‰è€…é€šå¸¸åº”è¯¥æ˜¯`root`

**æ‰§è¡Œé¡ºåº**ï¼š
- æŒ‰ç…§**å­—æ¯æ•°å­—é¡ºåº**æ‰§è¡Œ
- å¯ä»¥ç”¨æ•°å­—å‰ç¼€æ§åˆ¶æ‰§è¡Œé¡ºåºï¼š`01-first`ã€`02-second`

### 5.3 run-partså¸¸ç”¨é€‰é¡¹


**ğŸ” --reporté€‰é¡¹**ï¼šæ˜¾ç¤ºæ‰§è¡ŒæŠ¥å‘Š
```bash
# æ˜¾ç¤ºè¯¦ç»†æ‰§è¡Œè¿‡ç¨‹
run-parts --report /etc/cron.daily/
# è¾“å‡ºï¼š
# /etc/cron.daily/apt
# /etc/cron.daily/dpkg  
# /etc/cron.daily/locate
```

**ğŸ§ª --testé€‰é¡¹**ï¼šæµ‹è¯•æ¨¡å¼ï¼Œåªæ˜¾ç¤ºä¼šæ‰§è¡Œå“ªäº›è„šæœ¬
```bash
# æµ‹è¯•æ¨¡å¼ï¼Œä¸å®é™…æ‰§è¡Œ
run-parts --test /etc/cron.hourly/
# è¾“å‡ºï¼š/etc/cron.hourly/0anacron
```

**ğŸ“Š --listé€‰é¡¹**ï¼šåˆ—å‡ºæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶
```bash
run-parts --list /etc/cron.weekly/
```

### 5.4 run-partsåœ¨ç³»ç»Ÿä¸­çš„åº”ç”¨


**åœ¨/etc/crontabä¸­çš„ä½¿ç”¨**ï¼š
```bash
# /etc/crontabæ–‡ä»¶ä¸­çš„å…¸å‹é…ç½®
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6    * * 0   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
```

**å‘½ä»¤è§£æ**ï¼š
- `cd /`ï¼šåˆ‡æ¢åˆ°æ ¹ç›®å½•æ‰§è¡Œ
- `test -x /usr/sbin/anacron ||`ï¼šå¦‚æœanacronä¸å­˜åœ¨æ‰æ‰§è¡Œåé¢çš„å‘½ä»¤
- `run-parts --report`ï¼šæ‰§è¡Œç›®å½•ä¸­çš„è„šæœ¬å¹¶æ˜¾ç¤ºæŠ¥å‘Š

### 5.5 æ‰‹åŠ¨ä½¿ç”¨run-parts


**æµ‹è¯•å®šæ—¶ä»»åŠ¡**ï¼š
```bash
# æ‰‹åŠ¨æ‰§è¡Œæ¯æ—¥ä»»åŠ¡è¿›è¡Œæµ‹è¯•
sudo run-parts --report /etc/cron.daily/

# æŸ¥çœ‹ä¼šæ‰§è¡Œå“ªäº›weeklyä»»åŠ¡
sudo run-parts --test /etc/cron.weekly/
```

**åˆ›å»ºè‡ªå®šä¹‰ä»»åŠ¡ç›®å½•**ï¼š
```bash
# åˆ›å»ºè‡ªå®šä¹‰ä»»åŠ¡ç›®å½•
sudo mkdir /etc/cron.custom
sudo chmod 755 /etc/cron.custom

# æ·»åŠ è„šæœ¬å¹¶è®¾ç½®æƒé™
sudo vim /etc/cron.custom/my-task
sudo chmod +x /etc/cron.custom/my-task

# æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•
sudo run-parts /etc/cron.custom/
```

---

## 6. ğŸ‘¤ ç³»ç»Ÿä»»åŠ¡ç”¨æˆ·æƒé™ç®¡ç†


### 6.1 ç”¨æˆ·èº«ä»½æ‰§è¡Œçš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦æŒ‡å®šç”¨æˆ·**ï¼šç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡å¯èƒ½éœ€è¦ä»¥**ä¸åŒç”¨æˆ·èº«ä»½**è¿è¡Œï¼Œä»¥æ»¡è¶³ä¸åŒçš„æƒé™éœ€æ±‚ã€‚

```
æƒé™éœ€æ±‚ç¤ºä¾‹ï¼š

rootç”¨æˆ·ä»»åŠ¡ï¼š
- ç³»ç»Ÿå¤‡ä»½ã€æ—¥å¿—æ¸…ç†
- ç³»ç»ŸæœåŠ¡é‡å¯ã€é…ç½®ä¿®æ”¹
- ç³»ç»Ÿå®‰å…¨æ‰«æã€æ›´æ–°å®‰è£…

æ™®é€šç”¨æˆ·ä»»åŠ¡ï¼š  
- WebæœåŠ¡å™¨ç¼“å­˜æ¸…ç† (www-dataç”¨æˆ·)
- æ•°æ®åº“ç»´æŠ¤æ“ä½œ (mysqlç”¨æˆ·)
- åº”ç”¨ç¨‹åºæ•°æ®å¤„ç† (appç”¨æˆ·)
```

### 6.2 ç”¨æˆ·è®¾ç½®æ–¹å¼


**åœ¨/etc/crontabä¸­è®¾ç½®ç”¨æˆ·**ï¼š
```bash
# æ ¼å¼ï¼šåˆ† æ—¶ æ—¥ æœˆ å‘¨ ç”¨æˆ·å å‘½ä»¤

# ä»¥rootèº«ä»½æ‰§è¡Œç³»ç»Ÿå¤‡ä»½
0 2 * * * root /usr/local/bin/system-backup.sh

# ä»¥www-dataèº«ä»½æ¸…ç†Webç¼“å­˜  
0 1 * * * www-data /var/www/app/clear-cache.sh

# ä»¥mysqlèº«ä»½æ‰§è¡Œæ•°æ®åº“ä¼˜åŒ–
30 3 * * 0 mysql /usr/local/bin/optimize-db.sh

# ä»¥æ™®é€šç”¨æˆ·èº«ä»½æ‰§è¡Œåº”ç”¨ä»»åŠ¡
0 */4 * * * appuser /home/appuser/bin/process-data.sh
```

### 6.3 ç”¨æˆ·æƒé™éªŒè¯


**æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨**ï¼š
```bash
# æ£€æŸ¥ç³»ç»Ÿä¸­çš„ç”¨æˆ·
grep "^www-data:" /etc/passwd
grep "^mysql:" /etc/passwd

# æˆ–ä½¿ç”¨idå‘½ä»¤
id www-data
id mysql
```

**æµ‹è¯•ç”¨æˆ·æƒé™**ï¼š
```bash
# åˆ‡æ¢åˆ°æŒ‡å®šç”¨æˆ·æµ‹è¯•å‘½ä»¤
sudo -u www-data /var/www/app/clear-cache.sh
sudo -u mysql /usr/local/bin/optimize-db.sh
```

### 6.4 å¸¸è§ç”¨æˆ·é…ç½®


**ç³»ç»ŸæœåŠ¡ç”¨æˆ·**ï¼š
```bash
# WebæœåŠ¡ç›¸å…³
*/15 * * * * www-data /var/www/html/cron.php
0 2 * * * nginx /usr/local/bin/nginx-log-rotation.sh

# æ•°æ®åº“ç›¸å…³  
0 3 * * * mysql /usr/local/bin/mysql-backup.sh
30 4 * * 0 postgres /usr/local/bin/vacuum-db.sh

# é‚®ä»¶æœåŠ¡
0 5 * * * mail /usr/local/bin/cleanup-mail-queue.sh
```

### 6.5 å®‰å…¨æ³¨æ„äº‹é¡¹


**ğŸ” æƒé™æœ€å°åŒ–åŸåˆ™**ï¼š
```
âŒ é”™è¯¯åšæ³•ï¼šæ‰€æœ‰ä»»åŠ¡éƒ½ç”¨rootç”¨æˆ·æ‰§è¡Œ
âœ… æ­£ç¡®åšæ³•ï¼šæ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„ç”¨æˆ·èº«ä»½

ç¤ºä¾‹ï¼š
- æ¸…ç†Webç¼“å­˜ â†’ ä½¿ç”¨www-dataï¼Œè€Œéroot  
- æ•°æ®åº“å¤‡ä»½ â†’ ä½¿ç”¨mysqlï¼Œè€Œéroot
- åªæœ‰ç³»ç»Ÿçº§æ“ä½œæ‰ä½¿ç”¨root
```

**âš ï¸ å®‰å…¨æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ–‡ä»¶æƒé™
ls -la /etc/crontab
ls -la /etc/cron.d/*

# ç¡®ä¿åªæœ‰rootå¯ä»¥ä¿®æ”¹
sudo chmod 644 /etc/crontab
sudo chown root:root /etc/crontab
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡ï¼šç”±ç®¡ç†å‘˜è®¾ç½®çš„ç³»ç»Ÿå±‚é¢è‡ªåŠ¨ä»»åŠ¡
ğŸ”¸ /etc/crontabï¼šç³»ç»Ÿä¸»è¦å®šæ—¶ä»»åŠ¡é…ç½®æ–‡ä»¶ï¼Œæ ¼å¼æ¯”ç”¨æˆ·crontabå¤šç”¨æˆ·åå­—æ®µ  
ğŸ”¸ /etc/cron.d/ï¼šæ¨¡å—åŒ–ä»»åŠ¡ç®¡ç†ç›®å½•ï¼Œæ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹ç®¡ç†ç›¸å…³ä»»åŠ¡
ğŸ”¸ é¢„è®¾æ—¶é—´ç›®å½•ï¼šhourlyã€dailyã€weeklyã€monthlyå››ä¸ªæ ‡å‡†æ‰§è¡Œæ—¶é—´ç›®å½•
ğŸ”¸ run-partsï¼šæ‰¹é‡æ‰§è¡Œç›®å½•ä¸­å¯æ‰§è¡Œè„šæœ¬çš„ç³»ç»Ÿå·¥å…·
ğŸ”¸ ç”¨æˆ·èº«ä»½ï¼šç³»ç»Ÿä»»åŠ¡å¯ä»¥æŒ‡å®šä¸åŒç”¨æˆ·èº«ä»½æ‰§è¡Œï¼Œéµå¾ªæƒé™æœ€å°åŒ–åŸåˆ™
```

### 7.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ /etc/crontabé…ç½®è¦ç‚¹**
```
æ ¼å¼è¦ç‚¹ï¼š
- æ¯”ç”¨æˆ·crontabå¤šä¸€ä¸ªç”¨æˆ·åå­—æ®µ  
- éœ€è¦è®¾ç½®SHELLã€PATHç­‰ç¯å¢ƒå˜é‡
- é€šå¸¸ä½¿ç”¨run-partsæ‰§è¡Œé¢„è®¾ç›®å½•ä»»åŠ¡

å¸¸ç”¨é…ç½®ï¼š
17 * * * * root cd / && run-parts --report /etc/cron.hourly
25 6 * * * root test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
```

**ğŸ”¹ é¢„è®¾ç›®å½•ä½¿ç”¨è¦ç‚¹**  
```
ç›®å½•å¯¹åº”å…³ç³»ï¼š
/etc/cron.hourly/  â†’ æ¯å°æ—¶17åˆ†æ‰§è¡Œ
/etc/cron.daily/   â†’ æ¯å¤©6ç‚¹25åˆ†æ‰§è¡Œ  
/etc/cron.weekly/  â†’ æ¯å‘¨æ—¥6ç‚¹47åˆ†æ‰§è¡Œ
/etc/cron.monthly/ â†’ æ¯æœˆ1å·6ç‚¹52åˆ†æ‰§è¡Œ

ä½¿ç”¨æ–¹æ³•ï¼š
1. å°†è„šæœ¬æ”¾å…¥å¯¹åº”ç›®å½•
2. è®¾ç½®å¯æ‰§è¡Œæƒé™ chmod +x
3. æ–‡ä»¶åä¸èƒ½åŒ…å«ç‚¹å·
4. æŒ‰å­—æ¯é¡ºåºæ‰§è¡Œ
```

**ğŸ”¹ ç”¨æˆ·æƒé™ç®¡ç†è¦ç‚¹**
```
æƒé™åŸåˆ™ï¼š
- rootï¼šç³»ç»Ÿçº§æ“ä½œï¼ˆå¤‡ä»½ã€æ¸…ç†ã€æœåŠ¡ç®¡ç†ï¼‰
- æœåŠ¡ç”¨æˆ·ï¼šåº”ç”¨ç›¸å…³æ“ä½œï¼ˆwww-dataã€mysqlã€nginxï¼‰  
- æ™®é€šç”¨æˆ·ï¼šç”¨æˆ·æ•°æ®å¤„ç†

å®‰å…¨è¦æ±‚ï¼š
- æ–‡ä»¶æƒé™644æˆ–æ›´ä¸¥æ ¼
- åªæœ‰rootå¯ä¿®æ”¹ç³»ç»Ÿå®šæ—¶ä»»åŠ¡é…ç½®
- éµå¾ªæœ€å°æƒé™åŸåˆ™
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š ä»»åŠ¡é…ç½®é€‰æ‹©**ï¼š

| åœºæ™¯ | æ¨èæ–¹å¼ | ç†ç”± |
|------|---------|------|
| ç®€å•å‘¨æœŸä»»åŠ¡ | é¢„è®¾æ—¶é—´ç›®å½• | æ“ä½œç®€å•ï¼Œæ—¶é—´æ ‡å‡†åŒ– |
| å¤æ‚æ—¶é—´ä»»åŠ¡ | /etc/crontab | çµæ´»çš„æ—¶é—´è®¾ç½® |
| æ¨¡å—åŒ–ç®¡ç† | /etc/cron.d/ | ä¾¿äºåˆ†ç±»å’Œç‰ˆæœ¬æ§åˆ¶ |
| æ‰¹é‡è„šæœ¬æ‰§è¡Œ | run-parts | è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜ |

**ğŸ› ï¸ æœ€ä½³å®è·µ**ï¼š
- **æµ‹è¯•ä¼˜å…ˆ**ï¼šä½¿ç”¨`run-parts --test`æµ‹è¯•ä»»åŠ¡
- **æ—¥å¿—è®°å½•**ï¼šé‡è¦ä»»åŠ¡æ·»åŠ æ—¥å¿—è¾“å‡º
- **æƒé™æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æ–‡ä»¶æƒé™å’Œæ‰€æœ‰è€…
- **å¤‡ä»½é…ç½®**ï¼šå®šæ—¶ä»»åŠ¡é…ç½®æ–‡ä»¶è¦å¤‡ä»½
- **ç›‘æ§æ‰§è¡Œ**ï¼šå…³æ³¨ä»»åŠ¡æ‰§è¡Œç»“æœå’Œç³»ç»Ÿè´Ÿè½½

**ğŸ’¡ è®°å¿†è¦ç‚¹**ï¼š
- ç³»ç»Ÿä»»åŠ¡æ¯”ç”¨æˆ·ä»»åŠ¡å¤šä¸ªç”¨æˆ·åå­—æ®µ
- é¢„è®¾ç›®å½•å°±æ˜¯æŠŠè„šæœ¬æ”¾è¿›å»å°±èƒ½æŒ‰æ—¶æ‰§è¡Œ  
- run-partsè´Ÿè´£æ‰¹é‡æ‰§è¡Œç›®å½•ä¸­çš„è„šæœ¬
- ä¸åŒä»»åŠ¡ç”¨ä¸åŒç”¨æˆ·èº«ä»½ï¼Œå®‰å…¨ç¬¬ä¸€
- cron.dç›®å½•ä¾¿äºæ¨¡å—åŒ–ç®¡ç†ä»»åŠ¡