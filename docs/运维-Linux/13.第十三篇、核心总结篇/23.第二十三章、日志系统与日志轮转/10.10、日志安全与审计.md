---
title: 10ã€æ—¥å¿—å®‰å…¨ä¸å®¡è®¡
---
## ğŸ“š ç›®å½•

1. [æ—¥å¿—å®‰å…¨åŸºç¡€æ¦‚å¿µ](#1-æ—¥å¿—å®‰å…¨åŸºç¡€æ¦‚å¿µ)
2. [æ—¥å¿—æ–‡ä»¶æƒé™åŠ å›º](#2-æ—¥å¿—æ–‡ä»¶æƒé™åŠ å›º)
3. [æ—¥å¿—ç¯¡æ”¹é˜²æŠ¤æœºåˆ¶](#3-æ—¥å¿—ç¯¡æ”¹é˜²æŠ¤æœºåˆ¶)
4. [é‡è¦æ—¥å¿—å®æ—¶å¤‡ä»½](#4-é‡è¦æ—¥å¿—å®æ—¶å¤‡ä»½)
5. [æ—¥å¿—è®¿é—®æƒé™æ§åˆ¶](#5-æ—¥å¿—è®¿é—®æƒé™æ§åˆ¶)
6. [æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†](#6-æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†)
7. [æ—¥å¿—ä¿ç•™æœŸé™ç­–ç•¥](#7-æ—¥å¿—ä¿ç•™æœŸé™ç­–ç•¥)
8. [åˆè§„è¦æ±‚ä¸å®¡è®¡æ ‡å‡†](#8-åˆè§„è¦æ±‚ä¸å®¡è®¡æ ‡å‡†)
9. [æ—¥å¿—å®‰å…¨äº‹ä»¶å“åº”](#9-æ—¥å¿—å®‰å…¨äº‹ä»¶å“åº”)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ æ—¥å¿—å®‰å…¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ—¥å¿—å®‰å…¨


**æ—¥å¿—å®‰å…¨**å°±æ˜¯ä¿æŠ¤ç³»ç»Ÿæ—¥å¿—ä¸è¢«æ¶æ„ä¿®æ”¹ã€åˆ é™¤æˆ–æ³„éœ²çš„ä¸€ç³»åˆ—æªæ–½ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ å®¶çš„ç›‘æ§å½•åƒå¯ä»¥è¢«éšæ„åˆ æ”¹ï¼Œé‚£è¿˜æœ‰ä»€ä¹ˆç”¨ï¼Ÿæ—¥å¿—å®‰å…¨å°±æ˜¯ç»™ç³»ç»Ÿçš„"ç›‘æ§å½•åƒ"åŠ æŠŠé”ã€‚

**ğŸ”¸ æ—¥å¿—å®‰å…¨çš„æ ¸å¿ƒç›®æ ‡**
```
å®Œæ•´æ€§ï¼ˆIntegrityï¼‰ï¼š
â€¢ æ—¥å¿—å†…å®¹ä¸èƒ½è¢«ç¯¡æ”¹
â€¢ ç¡®ä¿è®°å½•çš„çœŸå®å¯é 
â€¢ å°±åƒé“¶è¡Œæµæ°´ä¸èƒ½è¢«ä¿®æ”¹ä¸€æ ·

å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼š
â€¢ æ—¥å¿—ç³»ç»ŸæŒç»­å¯ç”¨
â€¢ å…³é”®æ—¶åˆ»èƒ½æŸ¥åˆ°éœ€è¦çš„ä¿¡æ¯
â€¢ åƒ110æŠ¥è­¦ç”µè¯ï¼Œå¿…é¡»24å°æ—¶ç•…é€š

ä¿å¯†æ€§ï¼ˆConfidentialityï¼‰ï¼š
â€¢ æ•æ„Ÿæ—¥å¿—ä¿¡æ¯ä¸æ³„éœ²
â€¢ åªæœ‰æˆæƒäººå‘˜æ‰èƒ½æŸ¥çœ‹
â€¢ å°±åƒç—…å†åªèƒ½åŒ»ç”Ÿå’Œæ‚£è€…æŸ¥çœ‹
```

### 1.2 æ—¥å¿—å®‰å…¨å¨èƒåˆ†æ


**ğŸš¨ å¸¸è§çš„æ—¥å¿—å®‰å…¨å¨èƒ**

```
å†…éƒ¨å¨èƒï¼š
æ¶æ„ç®¡ç†å‘˜ â†’ åˆ é™¤æ“ä½œç—•è¿¹
ç¦»èŒå‘˜å·¥ â†’ æ¶æ„ç ´åæ—¥å¿—
æƒé™æ»¥ç”¨ â†’ æŸ¥çœ‹ä¸è¯¥çœ‹çš„æ—¥å¿—

å¤–éƒ¨å¨èƒï¼š
é»‘å®¢å…¥ä¾µ â†’ æ¸…é™¤å…¥ä¾µç—•è¿¹
æ¶æ„è½¯ä»¶ â†’ ç¯¡æ”¹ç³»ç»Ÿæ—¥å¿—
ç½‘ç»œæ”»å‡» â†’ æ—¥å¿—ç³»ç»Ÿç˜«ç—ª

æŠ€æœ¯å¨èƒï¼š
ç¡¬ä»¶æ•…éšœ â†’ æ—¥å¿—æ•°æ®ä¸¢å¤±
è½¯ä»¶ç¼ºé™· â†’ æ—¥å¿—è®°å½•å¼‚å¸¸
é…ç½®é”™è¯¯ â†’ æ•æ„Ÿä¿¡æ¯æ³„éœ²
```

### 1.3 æ—¥å¿—å®‰å…¨é˜²æŠ¤ä½“ç³»


**ğŸ—ï¸ å¤šå±‚é˜²æŠ¤æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åº”ç”¨å±‚é˜²æŠ¤               â”‚ â† åº”ç”¨æ—¥å¿—åŠ å¯†ã€è„±æ•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ç³»ç»Ÿå±‚é˜²æŠ¤               â”‚ â† æƒé™æ§åˆ¶ã€å®¡è®¡ç­–ç•¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ç½‘ç»œå±‚é˜²æŠ¤               â”‚ â† æ—¥å¿—ä¼ è¾“åŠ å¯†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         å­˜å‚¨å±‚é˜²æŠ¤               â”‚ â† å¤‡ä»½ã€å®Œæ•´æ€§æ ¡éªŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜²æŠ¤åŸåˆ™ï¼š
ğŸ”¸ çºµæ·±é˜²å¾¡ï¼šå¤šå±‚ä¿æŠ¤ï¼Œå±‚å±‚è®¾é˜²
ğŸ”¸ æœ€å°æƒé™ï¼šåªç»™å¿…è¦çš„è®¿é—®æƒé™
ğŸ”¸ æŒç»­ç›‘æ§ï¼šå®æ—¶ç›‘æµ‹å¼‚å¸¸è¡Œä¸º
ğŸ”¸ å¿«é€Ÿå“åº”ï¼šåŠæ—¶å¤„ç†å®‰å…¨äº‹ä»¶
```

---

## 2. ğŸ” æ—¥å¿—æ–‡ä»¶æƒé™åŠ å›º


### 2.1 Linuxæ–‡ä»¶æƒé™åŸºç¡€


**æƒé™ä¸‰è¦ç´ **ï¼šè¯»ï¼ˆrï¼‰ã€å†™ï¼ˆwï¼‰ã€æ‰§è¡Œï¼ˆxï¼‰
**æƒé™å¯¹è±¡**ï¼šæ–‡ä»¶æ‰€æœ‰è€…ï¼ˆuï¼‰ã€åŒç»„ç”¨æˆ·ï¼ˆgï¼‰ã€å…¶ä»–ç”¨æˆ·ï¼ˆoï¼‰

```bash
# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æƒé™
ls -l /var/log/

# å…¸å‹è¾“å‡ºç¤ºä¾‹
-rw-r--r-- 1 root root 1024 Sep 19 10:30 messages
-rw------- 1 root root  512 Sep 19 10:30 secure
drwxr-x--- 2 syslog adm  4096 Sep 19 10:30 apache2/
```

**æƒé™è§£è¯»**ï¼š
- `messages`: 644æƒé™ï¼Œæ‰€æœ‰äººå¯è¯»ï¼Œåªæœ‰rootå¯å†™
- `secure`: 600æƒé™ï¼Œåªæœ‰rootå¯è¯»å†™
- `apache2/`: 750æƒé™ï¼Œç›®å½•æƒé™ï¼Œsyslogç”¨æˆ·å’Œadmç»„å¯è®¿é—®

### 2.2 æ—¥å¿—æ–‡ä»¶æƒé™æœ€ä½³å®è·µ


**ğŸ”¸ ç³»ç»Ÿæ—¥å¿—æƒé™è®¾ç½®**

| æ—¥å¿—ç±»å‹ | **æ¨èæƒé™** | **æ‰€æœ‰è€…** | **è¯´æ˜** |
|---------|-------------|-----------|---------|
| **ç³»ç»Ÿæ ¸å¿ƒæ—¥å¿—** | `600 (rw-------)` | `root:root` | æœ€é«˜å®‰å…¨çº§åˆ« |
| **åº”ç”¨æ—¥å¿—** | `640 (rw-r-----)` | `app:log` | åº”ç”¨å¯å†™ï¼Œæ—¥å¿—ç»„å¯è¯» |
| **WebæœåŠ¡å™¨æ—¥å¿—** | `644 (rw-r--r--)` | `www-data:www-data` | ä¾¿äºåˆ†æå’Œç›‘æ§ |
| **å®¡è®¡æ—¥å¿—** | `600 (rw-------)` | `root:root` | ä¸¥æ ¼ä¿æŠ¤ |

**å®é™…æƒé™é…ç½®ç¤ºä¾‹**ï¼š

```bash
# åŠ å›ºç³»ç»Ÿæ ¸å¿ƒæ—¥å¿—
chmod 600 /var/log/messages
chmod 600 /var/log/secure
chmod 600 /var/log/auth.log

# è®¾ç½®æ—¥å¿—ç›®å½•æƒé™
chmod 750 /var/log
chown root:adm /var/log

# åº”ç”¨æ—¥å¿—æƒé™é…ç½®
chmod 640 /var/log/apache2/access.log
chown www-data:adm /var/log/apache2/access.log
```

### 2.3 æƒé™åŠ å›ºè„šæœ¬


```bash
#!/bin/bash
# æ—¥å¿—æƒé™åŠ å›ºè„šæœ¬

echo "ğŸ”§ å¼€å§‹æ—¥å¿—æƒé™åŠ å›º..."

# ç³»ç»Ÿæ—¥å¿—åŠ å›º
system_logs=("/var/log/messages" "/var/log/secure" "/var/log/auth.log")
for log in "${system_logs[@]}"; do
    if [ -f "$log" ]; then
        chmod 600 "$log"
        chown root:root "$log"
        echo "âœ… å·²åŠ å›º: $log"
    fi
done

# å®¡è®¡æ—¥å¿—ç‰¹æ®Šå¤„ç†
if [ -f "/var/log/audit/audit.log" ]; then
    chmod 600 /var/log/audit/audit.log
    chown root:root /var/log/audit/audit.log
    echo "âœ… å·²åŠ å›ºå®¡è®¡æ—¥å¿—"
fi

# è®¾ç½®æ—¥å¿—ç›®å½•æƒé™
chmod 755 /var/log
echo "âœ… æ—¥å¿—ç›®å½•æƒé™è®¾ç½®å®Œæˆ"

echo "ğŸ‰ æƒé™åŠ å›ºå®Œæˆï¼"
```

### 2.4 æƒé™ç›‘æ§ä¸å‘Šè­¦


**è®¾ç½®æ–‡ä»¶æƒé™ç›‘æ§**ï¼š

```bash
# ä½¿ç”¨inotifyç›‘æ§æ—¥å¿—æ–‡ä»¶æƒé™å˜åŒ–
#!/bin/bash
inotifywait -m /var/log -e attrib --format '%w%f %e' | while read file event; do
    if [[ "$event" == "ATTRIB" ]]; then
        echo "âš ï¸  è­¦å‘Šï¼šæ—¥å¿—æ–‡ä»¶æƒé™è¢«ä¿®æ”¹ - $file"
        # å‘é€å‘Šè­¦é‚®ä»¶æˆ–è®°å½•åˆ°å®‰å…¨æ—¥å¿—
        logger -p security.warn "æ—¥å¿—æ–‡ä»¶æƒé™å¼‚å¸¸å˜æ›´: $file"
    fi
done
```

---

## 3. ğŸ›¡ï¸ æ—¥å¿—ç¯¡æ”¹é˜²æŠ¤æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯æ—¥å¿—ç¯¡æ”¹


**æ—¥å¿—ç¯¡æ”¹**å°±æ˜¯æ¶æ„ä¿®æ”¹æ—¥å¿—å†…å®¹ï¼Œä¼å›¾éšè—æŸäº›æ“ä½œç—•è¿¹ã€‚å°±åƒæœ‰äººå·å·ä¿®æ”¹è€ƒè¯•æˆç»©å•ä¸€æ ·ï¼Œç›®çš„æ˜¯æ©ç›–çœŸç›¸ã€‚

**ğŸ”¸ å¸¸è§ç¯¡æ”¹æ‰‹æ®µ**
```
ç›´æ¥ç¼–è¾‘ï¼š
â€¢ ç”¨vimç­‰ç¼–è¾‘å™¨ä¿®æ”¹æ—¥å¿—æ–‡ä»¶
â€¢ åˆ é™¤ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—è®°å½•
â€¢ ä¿®æ”¹å…³é”®æ“ä½œçš„è®°å½•

æ—¶é—´æ¬ºéª—ï¼š
â€¢ ä¿®æ”¹ç³»ç»Ÿæ—¶é—´æ¥ä¼ªé€ æ—¥å¿—æ—¶é—´æˆ³
â€¢ åœ¨ç‰¹å®šæ—¶é—´ç‚¹åœæ­¢æ—¥å¿—è®°å½•
â€¢ å›è°ƒç³»ç»Ÿæ—¶é—´è¦†ç›–æ—¥å¿—

å·¥å…·ç¯¡æ”¹ï¼š
â€¢ ä½¿ç”¨ä¸“é—¨çš„æ—¥å¿—æ¸…ç†å·¥å…·
â€¢ ä¿®æ”¹æ—¥å¿—è½®è½¬é…ç½®
â€¢ æ›¿æ¢æ—¥å¿—æ–‡ä»¶
```

### 3.2 æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ


**ä½¿ç”¨å“ˆå¸Œå€¼æ£€æµ‹ç¯¡æ”¹**

å“ˆå¸Œå€¼å°±åƒæ–‡ä»¶çš„"æŒ‡çº¹"ï¼Œå†…å®¹ç¨æœ‰å˜åŒ–ï¼ŒæŒ‡çº¹å°±å®Œå…¨ä¸åŒã€‚

```bash
# ä¸ºé‡è¦æ—¥å¿—åˆ›å»ºå“ˆå¸Œå€¼
#!/bin/bash

LOG_DIR="/var/log"
HASH_DIR="/var/log/.integrity"

# åˆ›å»ºæ ¡éªŒç›®å½•
mkdir -p "$HASH_DIR"

# ä¸ºå…³é”®æ—¥å¿—ç”Ÿæˆæ ¡éªŒå€¼
critical_logs=("messages" "secure" "auth.log" "audit/audit.log")

for log in "${critical_logs[@]}"; do
    if [ -f "$LOG_DIR/$log" ]; then
        # ç”ŸæˆMD5å’ŒSHA256åŒé‡æ ¡éªŒ
        md5sum "$LOG_DIR/$log" > "$HASH_DIR/${log//\//_}.md5"
        sha256sum "$LOG_DIR/$log" > "$HASH_DIR/${log//\//_}.sha256"
        echo "âœ… å·²ä¸º $log ç”Ÿæˆå®Œæ•´æ€§æ ¡éªŒ"
    fi
done
```

**å®Œæ•´æ€§æ£€éªŒè„šæœ¬**ï¼š

```bash
#!/bin/bash
# æ—¥å¿—å®Œæ•´æ€§æ£€éªŒ

verify_integrity() {
    local log_file="$1"
    local hash_file="$2"
    
    if [ ! -f "$log_file" ] || [ ! -f "$hash_file" ]; then
        echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨: $log_file æˆ– $hash_file"
        return 1
    fi
    
    # è®¡ç®—å½“å‰å“ˆå¸Œå€¼
    current_hash=$(sha256sum "$log_file" | cut -d' ' -f1)
    stored_hash=$(cat "$hash_file" | cut -d' ' -f1)
    
    if [ "$current_hash" = "$stored_hash" ]; then
        echo "âœ… $log_file å®Œæ•´æ€§éªŒè¯é€šè¿‡"
        return 0
    else
        echo "ğŸš¨ è­¦å‘Šï¼š$log_file å¯èƒ½è¢«ç¯¡æ”¹ï¼"
        logger -p security.crit "æ—¥å¿—æ–‡ä»¶å®Œæ•´æ€§æ£€éªŒå¤±è´¥: $log_file"
        return 1
    fi
}
```

### 3.3 åªè¯»æ—¥å¿—ä¿æŠ¤


**ä½¿ç”¨chattrè®¾ç½®ä¸å¯ä¿®æ”¹å±æ€§**

`chattr`å‘½ä»¤å¯ä»¥ç»™æ–‡ä»¶åŠ ä¸Šç‰¹æ®Šå±æ€§ï¼Œå³ä½¿æ˜¯rootç”¨æˆ·ä¹Ÿä¸èƒ½è½»æ˜“ä¿®æ”¹ã€‚

```bash
# è®¾ç½®æ—¥å¿—æ–‡ä»¶ä¸ºåªè¯»ä¸”ä¸å¯åˆ é™¤
chattr +a /var/log/messages    # åªèƒ½è¿½åŠ ï¼Œä¸èƒ½ä¿®æ”¹å·²æœ‰å†…å®¹
chattr +i /var/log/secure      # å®Œå…¨ä¸å¯ä¿®æ”¹

# æŸ¥çœ‹æ–‡ä»¶å±æ€§
lsattr /var/log/messages
# è¾“å‡º: -----a------- /var/log/messages

# å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œå¿…é¡»å…ˆç§»é™¤å±æ€§
chattr -a /var/log/messages
```

> âš ï¸ **æ³¨æ„**ï¼šä½¿ç”¨`+i`å±æ€§è¦è°¨æ…ï¼Œä¼šå½±å“æ—¥å¿—è½®è½¬ã€‚å»ºè®®ä½¿ç”¨`+a`å±æ€§ï¼Œå…è®¸è¿½åŠ æ–°å†…å®¹ã€‚

### 3.4 è¿œç¨‹æ—¥å¿—ä¿æŠ¤


**é›†ä¸­å¼æ—¥å¿—ä¿æŠ¤ç­–ç•¥**

å°†é‡è¦æ—¥å¿—å®æ—¶ä¼ è¾“åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå³ä½¿æœ¬åœ°è¢«ç¯¡æ”¹ï¼Œè¿œç¨‹è¿˜æœ‰å¤‡ä»½ã€‚

```bash
# é…ç½®rsyslogè¿œç¨‹ä¼ è¾“
echo "*.* $$log-server.company.com:514" >> /etc/rsyslog.conf

# é‡å¯rsyslogæœåŠ¡
systemctl restart rsyslog

# éªŒè¯è¿œç¨‹ä¼ è¾“
logger "æµ‹è¯•è¿œç¨‹æ—¥å¿—ä¼ è¾“"
```

**è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨é…ç½®**ï¼š

```bash
# æ¥æ”¶ç«¯é…ç½® /etc/rsyslog.conf
$ModLoad imudp
$UDPServerRun 514
$UDPServerAddress 0.0.0.0

# æŒ‰å®¢æˆ·ç«¯IPåˆ†åˆ«å­˜å‚¨
$template RemoteLogs,"/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log"
*.* ?RemoteLogs
```

---

## 4. ğŸ’¾ é‡è¦æ—¥å¿—å®æ—¶å¤‡ä»½


### 4.1 å¤‡ä»½ç­–ç•¥è®¾è®¡


**å¤‡ä»½çš„æœ¬è´¨**å°±æ˜¯ç»™é‡è¦æ•°æ®åš"ä¿é™©"ï¼Œç¡®ä¿åŸä»¶ä¸¢å¤±æ—¶è¿˜æœ‰å‰¯æœ¬å¯ç”¨ã€‚

**ğŸ”¸ å¤‡ä»½ç­–ç•¥ç±»å‹**

```
å®æ—¶å¤‡ä»½ï¼ˆHot Backupï¼‰ï¼š
âœ… ä¼˜ç‚¹ï¼šæ•°æ®æŸå¤±æœ€å°ï¼Œæ¢å¤å¿«é€Ÿ
âŒ ç¼ºç‚¹ï¼šèµ„æºæ¶ˆè€—å¤§ï¼Œæˆæœ¬é«˜
ğŸ¯ é€‚ç”¨ï¼šæ ¸å¿ƒä¸šåŠ¡æ—¥å¿—ã€å®¡è®¡æ—¥å¿—

å®šæ—¶å¤‡ä»½ï¼ˆScheduled Backupï¼‰ï¼š
âœ… ä¼˜ç‚¹ï¼šèµ„æºæ¶ˆè€—é€‚ä¸­ï¼Œå®ç°ç®€å•
âŒ ç¼ºç‚¹ï¼šå¯èƒ½ä¸¢å¤±æœ€è¿‘æ•°æ®
ğŸ¯ é€‚ç”¨ï¼šåº”ç”¨æ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—

å¢é‡å¤‡ä»½ï¼ˆIncremental Backupï¼‰ï¼š
âœ… ä¼˜ç‚¹ï¼šå­˜å‚¨ç©ºé—´çœï¼Œä¼ è¾“æ•ˆç‡é«˜
âŒ ç¼ºç‚¹ï¼šæ¢å¤å¤æ‚ï¼Œä¾èµ–é“¾é•¿
ğŸ¯ é€‚ç”¨ï¼šå†å²æ—¥å¿—å½’æ¡£
```

### 4.2 å®æ—¶å¤‡ä»½å®ç°


**ä½¿ç”¨rsyncå®ç°å®æ—¶åŒæ­¥**

`rsync`æ˜¯Linuxä¸‹æœ€å¸¸ç”¨çš„æ–‡ä»¶åŒæ­¥å·¥å…·ï¼Œå¯ä»¥å®ç°å¢é‡åŒæ­¥ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚

```bash
#!/bin/bash
# å®æ—¶æ—¥å¿—å¤‡ä»½è„šæœ¬

BACKUP_SERVER="backup.company.com"
BACKUP_USER="logbackup"
LOCAL_LOG_DIR="/var/log"
REMOTE_LOG_DIR="/backup/logs/$(hostname)"

# å®æ—¶åŒæ­¥å‡½æ•°
sync_logs() {
    # åŒæ­¥ç³»ç»Ÿæ—¥å¿—
    rsync -avz --delete \
        "$LOCAL_LOG_DIR/" \
        "$BACKUP_USER@$BACKUP_SERVER:$REMOTE_LOG_DIR/" \
        --exclude="*.tmp" \
        --exclude="lost+found"
    
    if [ $? -eq 0 ]; then
        echo "âœ… $(date): æ—¥å¿—åŒæ­¥æˆåŠŸ"
    else
        echo "âŒ $(date): æ—¥å¿—åŒæ­¥å¤±è´¥"
        logger -p local0.err "æ—¥å¿—å¤‡ä»½å¤±è´¥"
    fi
}

# æ‰§è¡ŒåŒæ­¥
sync_logs
```

**ä½¿ç”¨inotifyå®ç°æ–‡ä»¶å˜åŒ–è§¦å‘å¤‡ä»½**ï¼š

```bash
#!/bin/bash
# åŸºäºæ–‡ä»¶å˜åŒ–çš„å®æ—¶å¤‡ä»½

LOG_DIR="/var/log"
BACKUP_SCRIPT="/usr/local/bin/sync_logs.sh"

echo "ğŸ”„ å¯åŠ¨å®æ—¶æ—¥å¿—å¤‡ä»½ç›‘æ§..."

# ç›‘æ§æ—¥å¿—ç›®å½•å˜åŒ–
inotifywait -m -r "$LOG_DIR" -e create,modify,moved_to --format '%w%f %e' | \
while read file event; do
    # è¿‡æ»¤ä¸´æ—¶æ–‡ä»¶å’Œéæ—¥å¿—æ–‡ä»¶
    if [[ "$file" =~ \.(log|txt)$ ]] || [[ "$file" =~ (messages|secure|auth\.log)$ ]]; then
        echo "ğŸ“ æ£€æµ‹åˆ°æ—¥å¿—å˜åŒ–: $file ($event)"
        
        # å»¶è¿Ÿæ‰§è¡Œï¼Œé¿å…é¢‘ç¹åŒæ­¥
        sleep 5
        
        # æ‰§è¡Œå¤‡ä»½
        "$BACKUP_SCRIPT"
    fi
done
```

### 4.3 å¤‡ä»½éªŒè¯ä¸æ¢å¤


**å¤‡ä»½å®Œæ•´æ€§éªŒè¯**

å¤‡ä»½åšäº†ä¸ç­‰äºåšå¥½äº†ï¼Œå¿…é¡»å®šæœŸéªŒè¯å¤‡ä»½æ˜¯å¦å¯ç”¨ã€‚

```bash
#!/bin/bash
# å¤‡ä»½éªŒè¯è„šæœ¬

BACKUP_SERVER="backup.company.com"
BACKUP_USER="logbackup"
REMOTE_LOG_DIR="/backup/logs/$(hostname)"

verify_backup() {
    local local_file="$1"
    local remote_file="$BACKUP_USER@$BACKUP_SERVER:$REMOTE_LOG_DIR/${local_file#/var/log/}"
    
    # æ¯”è¾ƒæ–‡ä»¶å¤§å°
    local_size=$(stat -c%s "$local_file" 2>/dev/null || echo 0)
    remote_size=$(ssh "$BACKUP_USER@$BACKUP_SERVER" "stat -c%s $REMOTE_LOG_DIR/${local_file#/var/log/}" 2>/dev/null || echo 0)
    
    if [ "$local_size" -eq "$remote_size" ]; then
        echo "âœ… $local_file å¤‡ä»½éªŒè¯é€šè¿‡ (å¤§å°: $local_size å­—èŠ‚)"
    else
        echo "âš ï¸  $local_file å¤‡ä»½å¤§å°ä¸åŒ¹é… (æœ¬åœ°: $local_size, è¿œç¨‹: $remote_size)"
    fi
}

# éªŒè¯å…³é”®æ—¥å¿—æ–‡ä»¶
critical_logs=("/var/log/messages" "/var/log/secure" "/var/log/auth.log")
for log in "${critical_logs[@]}"; do
    if [ -f "$log" ]; then
        verify_backup "$log"
    fi
done
```

### 4.4 è‡ªåŠ¨åŒ–å¤‡ä»½é…ç½®


**crontabå®šæ—¶å¤‡ä»½é…ç½®**

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å¤‡ä»½ä»»åŠ¡
# æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡å¢é‡å¤‡ä»½
*/5 * * * * /usr/local/bin/incremental_backup.sh

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡å¤‡ä»½éªŒè¯
0 * * * * /usr/local/bin/verify_backup.sh

# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå®Œæ•´å¤‡ä»½
0 2 * * * /usr/local/bin/full_backup.sh

# æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ¸…ç†è¿‡æœŸå¤‡ä»½
0 3 * * 0 /usr/local/bin/cleanup_old_backups.sh
```

---

## 5. ğŸ‘¥ æ—¥å¿—è®¿é—®æƒé™æ§åˆ¶


### 5.1 æƒé™æ§åˆ¶åŸç†


**æƒé™æ§åˆ¶**å°±æ˜¯å†³å®š"è°èƒ½çœ‹ä»€ä¹ˆæ—¥å¿—"çš„è§„åˆ™ã€‚å°±åƒå›¾ä¹¦é¦†çš„å€Ÿé˜…æƒé™ï¼Œä¸åŒè¯»è€…å¯ä»¥å€Ÿé˜…çš„ä¹¦ç±ç±»å‹ä¸åŒã€‚

**ğŸ”¸ æƒé™æ§åˆ¶å±‚æ¬¡**

```
ç”¨æˆ·çº§åˆ«æ§åˆ¶ï¼š
ç³»ç»Ÿç®¡ç†å‘˜ â†’ æ‰€æœ‰æ—¥å¿—è®¿é—®æƒé™
åº”ç”¨ç®¡ç†å‘˜ â†’ ç‰¹å®šåº”ç”¨æ—¥å¿—æƒé™
æ™®é€šç”¨æˆ· â†’ ä»…è‡ªå·±çš„æ“ä½œæ—¥å¿—

æ—¶é—´çº§åˆ«æ§åˆ¶ï¼š
å®æ—¶è®¿é—® â†’ å½“å‰è¿è¡Œæ—¶æ—¥å¿—
å†å²è®¿é—® â†’ å½’æ¡£å†å²æ—¥å¿—
ç´§æ€¥è®¿é—® â†’ å®‰å…¨äº‹ä»¶ç›¸å…³æ—¥å¿—

å†…å®¹çº§åˆ«æ§åˆ¶ï¼š
å®Œæ•´æ—¥å¿— â†’ åŒ…å«æ‰€æœ‰å­—æ®µä¿¡æ¯
è¿‡æ»¤æ—¥å¿— â†’ éšè—æ•æ„Ÿä¿¡æ¯
æ‘˜è¦æ—¥å¿— â†’ ä»…æ˜¾ç¤ºå…³é”®ä¿¡æ¯
```

### 5.2 åŸºäºç”¨æˆ·ç»„çš„æƒé™æ§åˆ¶


**åˆ›å»ºæ—¥å¿—è®¿é—®ç”¨æˆ·ç»„**

```bash
# åˆ›å»ºä¸åŒæƒé™çº§åˆ«çš„ç”¨æˆ·ç»„
groupadd log-admin      # æ—¥å¿—ç®¡ç†å‘˜ç»„
groupadd log-analyst    # æ—¥å¿—åˆ†æå‘˜ç»„  
groupadd log-viewer     # æ—¥å¿—æŸ¥çœ‹å‘˜ç»„

# è®¾ç½®ç”¨æˆ·ç»„æƒé™
chgrp log-admin /var/log/secure
chmod 640 /var/log/secure      # ç®¡ç†å‘˜ç»„å¯è¯»

chgrp log-analyst /var/log/apache2/
chmod 750 /var/log/apache2/    # åˆ†æå‘˜ç»„å¯è®¿é—®Webæ—¥å¿—

chgrp log-viewer /var/log/messages
chmod 644 /var/log/messages    # æŸ¥çœ‹å‘˜ç»„å¯è¯»ç³»ç»Ÿæ—¥å¿—
```

**ç”¨æˆ·ç»„æƒé™åˆ†é…ç¤ºä¾‹**ï¼š

| ç”¨æˆ·ç»„ | **æƒé™èŒƒå›´** | **å¯è®¿é—®æ—¥å¿—** | **æ“ä½œæƒé™** |
|--------|-------------|---------------|-------------|
| `log-admin` | **å…¨éƒ¨æƒé™** | æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ | è¯»å†™ã€é…ç½®ã€å¤‡ä»½ |
| `log-analyst` | **åˆ†ææƒé™** | åº”ç”¨å’Œä¸šåŠ¡æ—¥å¿— | è¯»å–ã€åˆ†æã€æŠ¥å‘Š |
| `log-viewer` | **æŸ¥çœ‹æƒé™** | åŸºç¡€ç³»ç»Ÿæ—¥å¿— | ä»…è¯»å– |
| `app-user` | **åº”ç”¨æƒé™** | è‡ªå·±åº”ç”¨çš„æ—¥å¿— | è¯»å–åº”ç”¨æ—¥å¿— |

### 5.3 åŸºäºsudoçš„ç²¾ç»†æƒé™æ§åˆ¶


**sudoé…ç½®ç¤ºä¾‹**

sudoå¯ä»¥è®©æ™®é€šç”¨æˆ·ä»¥ç‰¹å®šæƒé™æ‰§è¡Œç‰¹å®šå‘½ä»¤ï¼Œéå¸¸é€‚åˆæ—¥å¿—æƒé™ç®¡ç†ã€‚

```bash
# ç¼–è¾‘sudoersæ–‡ä»¶
visudo

# æ·»åŠ æ—¥å¿—ç›¸å…³æƒé™é…ç½®
# å…è®¸log-analystç»„æŸ¥çœ‹åº”ç”¨æ—¥å¿—
%log-analyst ALL=(root) NOPASSWD: /bin/cat /var/log/apache2/*, \
                                  /bin/grep * /var/log/apache2/*, \
                                  /bin/tail -f /var/log/apache2/*

# å…è®¸log-viewerç»„æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆåªè¯»ï¼‰
%log-viewer ALL=(root) NOPASSWD: /bin/cat /var/log/messages, \
                                 /bin/cat /var/log/syslog, \
                                 /usr/bin/journalctl --no-pager

# ç¦æ­¢ç›´æ¥ç¼–è¾‘æ—¥å¿—æ–‡ä»¶
%log-analyst ALL=(root) !/bin/vi /var/log/*, \
                        !/bin/nano /var/log/*, \
                        !/bin/rm /var/log/*
```

### 5.4 åŸºäºæ—¶é—´çš„è®¿é—®æ§åˆ¶


**æ—¶é—´æ®µè®¿é—®é™åˆ¶è„šæœ¬**

```bash
#!/bin/bash
# åŸºäºæ—¶é—´çš„æ—¥å¿—è®¿é—®æ§åˆ¶

check_access_time() {
    local current_hour=$(date +%H)
    local current_day=$(date +%u)  # 1-7 (Monday-Sunday)
    
    # å·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€åˆ°å‘¨äº” 9:00-18:00
    if [ "$current_day" -ge 1 ] && [ "$current_day" -le 5 ]; then
        if [ "$current_hour" -ge 9 ] && [ "$current_hour" -lt 18 ]; then
            return 0  # å…è®¸è®¿é—®
        fi
    fi
    
    # éå·¥ä½œæ—¶é—´ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯ç´§æ€¥è®¿é—®
    echo "å½“å‰ä¸ºéå·¥ä½œæ—¶é—´ï¼Œæ˜¯å¦ç´§æ€¥è®¿é—®ï¼Ÿ(y/N)"
    read -r response
    
    if [[ "$response" =~ ^[Yy]$ ]]; then
        # è®°å½•ç´§æ€¥è®¿é—®
        logger -p security.info "ç”¨æˆ· $USER åœ¨éå·¥ä½œæ—¶é—´ç´§æ€¥è®¿é—®æ—¥å¿—"
        return 0
    else
        echo "âŒ éå·¥ä½œæ—¶é—´ä¸å…è®¸è®¿é—®æ—¥å¿—"
        return 1
    fi
}

# åœ¨æ—¥å¿—è®¿é—®è„šæœ¬ä¸­ä½¿ç”¨
if check_access_time; then
    echo "âœ… è®¿é—®æƒé™éªŒè¯é€šè¿‡"
    # æ‰§è¡Œæ—¥å¿—æŸ¥çœ‹æ“ä½œ
else
    echo "ğŸš« è®¿é—®è¢«æ‹’ç»"
    exit 1
fi
```

---

## 6. ğŸ­ æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†


### 6.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿä¿¡æ¯è„±æ•


**è„±æ•**å°±æ˜¯æŠŠæ—¥å¿—ä¸­çš„æ•æ„Ÿä¿¡æ¯"æ‰“é©¬èµ›å…‹"ï¼Œè®©åˆ«äººçœ‹ä¸åˆ°å…·ä½“å†…å®¹ï¼Œä½†ä¸å½±å“æ—¥å¿—åˆ†æã€‚å°±åƒç”µè§†æ–°é—»ä¸­ç»™å½“äº‹äººé¢éƒ¨æ‰“é©¬èµ›å…‹ä¸€æ ·ã€‚

**ğŸ”¸ å¸¸è§æ•æ„Ÿä¿¡æ¯ç±»å‹**
```
ä¸ªäººèº«ä»½ä¿¡æ¯ï¼š
â€¢ èº«ä»½è¯å·ï¼š320123199001011234 â†’ 320123****1234
â€¢ æ‰‹æœºå·ç ï¼š13812345678 â†’ 138****5678
â€¢ é‚®ç®±åœ°å€ï¼šuser@example.com â†’ u***@example.com

é‡‘èä¿¡æ¯ï¼š
â€¢ é“¶è¡Œå¡å·ï¼š6222021234567890 â†’ 6222****7890  
â€¢ æ”¯ä»˜å¯†ç ï¼š123456 â†’ ******
â€¢ äº¤æ˜“é‡‘é¢ï¼šä¿ç•™æˆ–åˆ†æ®µéšè—

ç³»ç»Ÿä¿¡æ¯ï¼š
â€¢ æ•°æ®åº“å¯†ç ï¼šmypassword123 â†’ ***
â€¢ APIå¯†é’¥ï¼šsk-1234567890abcdef â†’ sk-****
â€¢ å†…ç½‘IPï¼š192.168.1.100 â†’ 192.168.*.***
```

### 6.2 å®æ—¶æ—¥å¿—è„±æ•


**ä½¿ç”¨sedè¿›è¡Œå®æ—¶è„±æ•**

`sed`æ˜¯Linuxä¸‹çš„æµç¼–è¾‘å™¨ï¼Œå¯ä»¥å®æ—¶å¤„ç†æ—¥å¿—å†…å®¹ã€‚

```bash
#!/bin/bash
# å®æ—¶æ—¥å¿—è„±æ•è„šæœ¬

# è„±æ•è§„åˆ™å®šä¹‰
mask_sensitive_data() {
    sed -E \
        -e 's/[0-9]{15,19}/****CARD****/g' \
        -e 's/1[3-9][0-9]{9}/****PHONE****/g' \
        -e 's/[0-9]{17}[0-9X]/****ID****/g' \
        -e 's/password=[^[:space:]]*/password=****/g' \
        -e 's/pwd=[^[:space:]]*/pwd=****/g' \
        -e 's/([0-9]{1,3}\.){3}[0-9]{1,3}/***IP***/g'
}

# å®æ—¶ç›‘æ§å¹¶è„±æ•
tail -f /var/log/application.log | mask_sensitive_data
```

**Apacheè®¿é—®æ—¥å¿—è„±æ•ç¤ºä¾‹**ï¼š

```bash
#!/bin/bash
# Apacheæ—¥å¿—IPè„±æ•

apache_log_mask() {
    # åŸå§‹æ—¥å¿—æ ¼å¼ï¼š
    # 192.168.1.100 - - [19/Sep/2023:10:30:15 +0800] "GET /user/profile?id=123 HTTP/1.1" 200 1234
    
    # è„±æ•åæ ¼å¼ï¼š
    # XXX.XXX.1.100 - - [19/Sep/2023:10:30:15 +0800] "GET /user/profile?id=*** HTTP/1.1" 200 1234
    
    sed -E \
        -e 's/^([0-9]{1,3}\.[0-9]{1,3}\.)[0-9]{1,3}\.([0-9]{1,3})/XXX.XXX.\2/g' \
        -e 's/id=[0-9]+/id=***/g' \
        -e 's/user=[^[:space:]]*/user=***/g'
}

# åº”ç”¨åˆ°Apacheæ—¥å¿—
cat /var/log/apache2/access.log | apache_log_mask > /var/log/apache2/access_masked.log
```

### 6.3 æ•°æ®åº“æ—¥å¿—è„±æ•


**MySQLæ…¢æŸ¥è¯¢æ—¥å¿—è„±æ•**

```bash
#!/bin/bash
# MySQLæ…¢æŸ¥è¯¢æ—¥å¿—è„±æ•

mysql_log_mask() {
    # å¤„ç†SQLè¯­å¥ä¸­çš„æ•æ„Ÿæ•°æ®
    sed -E \
        -e "s/'[0-9]{11,19}'/'***PHONE***'/g" \
        -e "s/'[0-9]{15,19}'/'***CARD***'/g" \
        -e "s/password\s*=\s*'[^']*'/password = '***'/g" \
        -e "s/WHERE\s+id\s*=\s*[0-9]+/WHERE id = ***/g" \
        -e "s/VALUES\s*\([^)]*\)/VALUES (**masked**)/g"
}

# ç¤ºä¾‹ä½¿ç”¨
echo "SELECT * FROM users WHERE phone = '13812345678' AND password = 'secret123';" | mysql_log_mask
# è¾“å‡ºï¼šSELECT * FROM users WHERE phone = '***PHONE***' AND password = '***';
```

### 6.4 è„±æ•é…ç½®ç®¡ç†


**å¯é…ç½®çš„è„±æ•è§„åˆ™**

```bash
# è„±æ•è§„åˆ™é…ç½®æ–‡ä»¶ /etc/log-mask.conf
# æ ¼å¼ï¼šè§„åˆ™åç§°|æ­£åˆ™è¡¨è¾¾å¼|æ›¿æ¢å†…å®¹|è¯´æ˜

PHONE_MASK|1[3-9][0-9]{9}|****PHONE****|æ‰‹æœºå·ç è„±æ•
ID_CARD_MASK|[0-9]{17}[0-9X]|****ID****|èº«ä»½è¯å·è„±æ•  
EMAIL_MASK|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}|****EMAIL****|é‚®ç®±è„±æ•
IP_MASK|([0-9]{1,3}\.){3}[0-9]{1,3}|***IP***|IPåœ°å€è„±æ•
PASSWORD_MASK|password=[^[:space:]]*|password=****|å¯†ç è„±æ•
```

**åŠ¨æ€è„±æ•å¤„ç†è„šæœ¬**ï¼š

```bash
#!/bin/bash
# åŸºäºé…ç½®çš„åŠ¨æ€è„±æ•å¤„ç†

MASK_CONFIG="/etc/log-mask.conf"

apply_mask_rules() {
    local input_text="$1"
    local result="$input_text"
    
    # è¯»å–è„±æ•è§„åˆ™é…ç½®
    while IFS='|' read -r rule_name pattern replacement description; do
        # è·³è¿‡æ³¨é‡Šè¡Œ
        [[ "$rule_name" =~ ^#.*$ ]] && continue
        [[ -z "$rule_name" ]] && continue
        
        # åº”ç”¨è„±æ•è§„åˆ™
        result=$(echo "$result" | sed -E "s/$pattern/$replacement/g")
        
    done < "$MASK_CONFIG"
    
    echo "$result"
}

# ä½¿ç”¨ç¤ºä¾‹
original_log="ç”¨æˆ·13812345678ç™»å½•æˆåŠŸï¼ŒIPï¼š192.168.1.100ï¼Œå¯†ç ï¼špassword=secret123"
masked_log=$(apply_mask_rules "$original_log")
echo "åŸå§‹æ—¥å¿—ï¼š$original_log"
echo "è„±æ•æ—¥å¿—ï¼š$masked_log"
```

---

## 7. ğŸ“… æ—¥å¿—ä¿ç•™æœŸé™ç­–ç•¥


### 7.1 æ—¥å¿—ä¿ç•™æœŸé™çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¿ç•™æœŸé™**ï¼Ÿå°±åƒå®¶é‡Œçš„æ‚ç‰©ï¼Œä¸åŠæ—¶æ¸…ç†å°±ä¼šå †ç§¯å¦‚å±±ã€‚æ—¥å¿—ä¹Ÿä¸€æ ·ï¼Œä¸åˆç†ç®¡ç†ä¼šå æ»¡ç£ç›˜ç©ºé—´ï¼Œè¿˜å¯èƒ½å¸¦æ¥åˆè§„é£é™©ã€‚

**ğŸ”¸ ä¿ç•™æœŸé™è€ƒè™‘å› ç´ **

```
æ³•è§„è¦æ±‚ï¼š
â€¢ é‡‘èè¡Œä¸šï¼šé€šå¸¸è¦æ±‚ä¿ç•™3-7å¹´
â€¢ åŒ»ç–—è¡Œä¸šï¼šéƒ¨åˆ†æ•°æ®éœ€è¦æ°¸ä¹…ä¿ç•™  
â€¢ æ”¿åºœæœºæ„ï¼šæŒ‰ç…§æ¡£æ¡ˆæ³•è¦æ±‚ä¿ç•™
â€¢ ä¸€èˆ¬ä¼ä¸šï¼šå»ºè®®ä¿ç•™1-3å¹´

ä¸šåŠ¡éœ€è¦ï¼š
â€¢ æ•…éšœæ’æŸ¥ï¼šæœ€è¿‘3-6ä¸ªæœˆçš„è¯¦ç»†æ—¥å¿—
â€¢ è¶‹åŠ¿åˆ†æï¼šè‡³å°‘1å¹´çš„å†å²æ•°æ®
â€¢ å®¡è®¡è°ƒæŸ¥ï¼šå¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´çš„è®°å½•
â€¢ æ€§èƒ½ç›‘æ§ï¼šå®æ—¶å’Œè¿‘æœŸæ•°æ®

æŠ€æœ¯é™åˆ¶ï¼š
â€¢ å­˜å‚¨ç©ºé—´ï¼šç£ç›˜å®¹é‡é™åˆ¶
â€¢ æŸ¥è¯¢æ€§èƒ½ï¼šæ•°æ®é‡è¿‡å¤§å½±å“æŸ¥è¯¢é€Ÿåº¦
â€¢ å¤‡ä»½æˆæœ¬ï¼šé•¿æœŸä¿å­˜çš„æˆæœ¬è€ƒé‡
â€¢ ç®¡ç†å¤æ‚åº¦ï¼šæ•°æ®è¶Šå¤šç®¡ç†è¶Šå¤æ‚
```

### 7.2 åˆ†çº§ä¿ç•™ç­–ç•¥


**ä¸åŒç±»å‹æ—¥å¿—çš„ä¿ç•™ç­–ç•¥**

| æ—¥å¿—ç±»å‹ | **ä¿ç•™æœŸé™** | **å­˜å‚¨æ–¹å¼** | **è¯´æ˜** |
|---------|-------------|-------------|---------|
| **å®‰å…¨å®¡è®¡æ—¥å¿—** | `7å¹´` | åœ¨çº¿1å¹´ + ç¦»çº¿å­˜æ¡£ | æ³•è§„è¦æ±‚ï¼Œå¿…é¡»é•¿æœŸä¿ç•™ |
| **ç³»ç»Ÿè¿è¡Œæ—¥å¿—** | `1å¹´` | åœ¨çº¿3ä¸ªæœˆ + å½’æ¡£å­˜å‚¨ | æ•…éšœæ’æŸ¥å’Œæ€§èƒ½åˆ†æ |
| **åº”ç”¨ä¸šåŠ¡æ—¥å¿—** | `2å¹´` | åœ¨çº¿6ä¸ªæœˆ + å†·å­˜å‚¨ | ä¸šåŠ¡åˆ†æå’Œç”¨æˆ·è¡Œä¸ºè·Ÿè¸ª |
| **Webè®¿é—®æ—¥å¿—** | `6ä¸ªæœˆ` | åœ¨çº¿1ä¸ªæœˆ + å‹ç¼©å­˜å‚¨ | æµé‡åˆ†æå’Œå®‰å…¨ç›‘æ§ |
| **è°ƒè¯•æ—¥å¿—** | `1ä¸ªæœˆ` | ä»…åœ¨çº¿å­˜å‚¨ | å¼€å‘è°ƒè¯•ï¼ŒçŸ­æœŸæœ‰æ•ˆ |
| **ä¸´æ—¶æ—¥å¿—** | `7å¤©` | ä»…åœ¨çº¿å­˜å‚¨ | ä¸´æ—¶æ’é”™ï¼Œå¿«é€Ÿæ¸…ç† |

### 7.3 è‡ªåŠ¨åŒ–æ¸…ç†ç­–ç•¥


**åŸºäºæ—¶é—´çš„è‡ªåŠ¨æ¸…ç†**

```bash
#!/bin/bash
# è‡ªåŠ¨æ—¥å¿—æ¸…ç†è„šæœ¬

LOG_BASE_DIR="/var/log"
ARCHIVE_DIR="/var/log/archive"

# åˆ›å»ºå½’æ¡£ç›®å½•
mkdir -p "$ARCHIVE_DIR"

cleanup_logs() {
    local log_type="$1"
    local keep_days="$2"
    local log_pattern="$3"
    
    echo "ğŸ§¹ å¼€å§‹æ¸…ç† $log_type æ—¥å¿—ï¼ˆä¿ç•™ $keep_days å¤©ï¼‰"
    
    # æŸ¥æ‰¾è¿‡æœŸæ–‡ä»¶
    find "$LOG_BASE_DIR" -name "$log_pattern" -type f -mtime +$keep_days | while read -r file; do
        echo "ğŸ“ å¤„ç†è¿‡æœŸæ—¥å¿—ï¼š$file"
        
        # å‹ç¼©åç§»åŠ¨åˆ°å½’æ¡£ç›®å½•
        gzip "$file"
        mv "${file}.gz" "$ARCHIVE_DIR/"
        
        echo "âœ… å·²å½’æ¡£ï¼š$(basename "$file")"
    done
}

# æ‰§è¡Œä¸åŒç±»å‹æ—¥å¿—çš„æ¸…ç†
cleanup_logs "Webè®¿é—®æ—¥å¿—" 30 "access.log.*"
cleanup_logs "é”™è¯¯æ—¥å¿—" 90 "error.log.*"  
cleanup_logs "ç³»ç»Ÿæ—¥å¿—" 365 "messages.*"
cleanup_logs "è°ƒè¯•æ—¥å¿—" 7 "debug.log.*"

echo "ğŸ‰ æ—¥å¿—æ¸…ç†å®Œæˆï¼"
```

### 7.4 æ™ºèƒ½å½’æ¡£ç­–ç•¥


**åŸºäºæ—¥å¿—å†…å®¹é‡è¦æ€§çš„å½’æ¡£**

```bash
#!/bin/bash
# æ™ºèƒ½æ—¥å¿—å½’æ¡£è„šæœ¬

analyze_log_importance() {
    local log_file="$1"
    local importance_score=0
    
    # æ£€æŸ¥æ˜¯å¦åŒ…å«é‡è¦å…³é”®è¯
    important_keywords=("ERROR" "CRITICAL" "FATAL" "SECURITY" "UNAUTHORIZED" "FAILED")
    
    for keyword in "${important_keywords[@]}"; do
        count=$(grep -c "$keyword" "$log_file" 2>/dev/null || echo 0)
        importance_score=$((importance_score + count))
    done
    
    echo $importance_score
}

smart_archive() {
    local log_file="$1"
    local base_retention_days="$2"
    
    # è®¡ç®—é‡è¦æ€§åˆ†æ•°
    score=$(analyze_log_importance "$log_file")
    
    # æ ¹æ®é‡è¦æ€§è°ƒæ•´ä¿ç•™æœŸé™
    if [ "$score" -gt 50 ]; then
        retention_days=$((base_retention_days * 3))  # é‡è¦æ—¥å¿—ä¿ç•™3å€æ—¶é—´
        echo "ğŸ”¥ é«˜é‡è¦æ€§æ—¥å¿—ï¼š$log_file (åˆ†æ•°: $score, ä¿ç•™: ${retention_days}å¤©)"
    elif [ "$score" -gt 10 ]; then
        retention_days=$((base_retention_days * 2))  # ä¸­ç­‰é‡è¦æ€§ä¿ç•™2å€æ—¶é—´
        echo "âš¡ ä¸­é‡è¦æ€§æ—¥å¿—ï¼š$log_file (åˆ†æ•°: $score, ä¿ç•™: ${retention_days}å¤©)"
    else
        retention_days=$base_retention_days          # æ™®é€šæ—¥å¿—æŒ‰åŸºç¡€æœŸé™ä¿ç•™
        echo "ğŸ“„ æ™®é€šæ—¥å¿—ï¼š$log_file (åˆ†æ•°: $score, ä¿ç•™: ${retention_days}å¤©)"
    fi
    
    # è®¾ç½®å½’æ¡£æ ‡è®°
    touch "$log_file.retention_$retention_days"
}
```

### 7.5 ä¿ç•™ç­–ç•¥ç›‘æ§


**ä¿ç•™ç­–ç•¥æ‰§è¡Œç›‘æ§**

```bash
#!/bin/bash
# æ—¥å¿—ä¿ç•™ç­–ç•¥ç›‘æ§è„šæœ¬

REPORT_FILE="/var/log/retention_report.log"

generate_retention_report() {
    echo "ğŸ“Š æ—¥å¿—ä¿ç•™ç­–ç•¥æ‰§è¡ŒæŠ¥å‘Š - $(date)" > "$REPORT_FILE"
    echo "=====================================" >> "$REPORT_FILE"
    
    # ç»Ÿè®¡å„ç±»æ—¥å¿—çš„æ•°é‡å’Œå¤§å°
    for log_dir in /var/log/*/; do
        if [ -d "$log_dir" ]; then
            dir_name=$(basename "$log_dir")
            file_count=$(find "$log_dir" -type f -name "*.log*" | wc -l)
            total_size=$(du -sh "$log_dir" | cut -f1)
            oldest_file=$(find "$log_dir" -type f -name "*.log*" -printf '%T@ %p\n' | sort -n | head -1 | cut -d' ' -f2-)
            
            echo "ğŸ“ ç›®å½•ï¼š$dir_name" >> "$REPORT_FILE"
            echo "   æ–‡ä»¶æ•°é‡ï¼š$file_count" >> "$REPORT_FILE"
            echo "   æ€»å¤§å°ï¼š$total_size" >> "$REPORT_FILE"
            echo "   æœ€æ—§æ–‡ä»¶ï¼š$(basename "$oldest_file") ($(date -r "$oldest_file" '+%Y-%m-%d'))" >> "$REPORT_FILE"
            echo "" >> "$REPORT_FILE"
        fi
    done
    
    # æ£€æŸ¥å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ
    echo "ğŸ’¾ å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š" >> "$REPORT_FILE"
    df -h /var/log >> "$REPORT_FILE"
    
    echo "âœ… æŠ¥å‘Šå·²ç”Ÿæˆï¼š$REPORT_FILE"
}

# ç”ŸæˆæŠ¥å‘Š
generate_retention_report

# æ£€æŸ¥æ˜¯å¦éœ€è¦å‘Šè­¦
log_usage=$(df /var/log | tail -1 | awk '{print $5}' | sed 's/%//')
if [ "$log_usage" -gt 80 ]; then
    echo "âš ï¸  è­¦å‘Šï¼šæ—¥å¿—å­˜å‚¨ç©ºé—´ä½¿ç”¨ç‡è¿‡é«˜ ($log_usage%)"
    logger -p local0.warn "æ—¥å¿—å­˜å‚¨ç©ºé—´å‘Šè­¦ï¼šä½¿ç”¨ç‡ $log_usage%"
fi
```

---

## 8. ğŸ“‹ åˆè§„è¦æ±‚ä¸å®¡è®¡æ ‡å‡†


### 8.1 ä¸»è¦åˆè§„æ¡†æ¶


**å¸¸è§çš„åˆè§„è¦æ±‚**å°±æ˜¯å„è¡Œå„ä¸šå¿…é¡»éµå®ˆçš„"æ¸¸æˆè§„åˆ™"ï¼Œä¸éµå®ˆå°±å¯èƒ½é¢ä¸´æ³•å¾‹é£é™©ã€‚

**ğŸ”¸ å›½é™…æ ‡å‡†æ¡†æ¶**

```
SOXæ³•æ¡ˆï¼ˆè¨ç­æ–¯-å¥¥å…‹æ–¯åˆ©æ³•æ¡ˆï¼‰ï¼š
ğŸ“Š é€‚ç”¨ï¼šç¾å›½ä¸Šå¸‚å…¬å¸
ğŸ¯ è¦æ±‚ï¼šè´¢åŠ¡ç›¸å…³ç³»ç»Ÿçš„è®¿é—®å®¡è®¡
â° ä¿ç•™ï¼š7å¹´è´¢åŠ¡ç›¸å…³æ—¥å¿—
ğŸ” é‡ç‚¹ï¼šç”¨æˆ·è®¿é—®ã€æ•°æ®å˜æ›´ã€æƒé™ç®¡ç†

PCI DSSï¼ˆæ”¯ä»˜å¡è¡Œä¸šæ•°æ®å®‰å…¨æ ‡å‡†ï¼‰ï¼š
ğŸ’³ é€‚ç”¨ï¼šå¤„ç†ä¿¡ç”¨å¡äº¤æ˜“çš„ç»„ç»‡
ğŸ¯ è¦æ±‚ï¼šæ”¯ä»˜ç³»ç»Ÿçš„å…¨é¢å®¡è®¡
â° ä¿ç•™ï¼šè‡³å°‘1å¹´çš„å®¡è®¡æ—¥å¿—
ğŸ” é‡ç‚¹ï¼šè®¿é—®æ§åˆ¶ã€ç½‘ç»œç›‘æ§ã€æ¼æ´ç®¡ç†

HIPAAï¼ˆå¥åº·ä¿é™©ä¾¿æºæ€§å’Œè´£ä»»æ³•æ¡ˆï¼‰ï¼š
ğŸ¥ é€‚ç”¨ï¼šåŒ»ç–—ä¿å¥è¡Œä¸š
ğŸ¯ è¦æ±‚ï¼šæ‚£è€…ä¿¡æ¯è®¿é—®çš„å®¡è®¡
â° ä¿ç•™ï¼š6å¹´ä»¥ä¸Šçš„å®¡è®¡è®°å½•
ğŸ” é‡ç‚¹ï¼šæ•°æ®è®¿é—®ã€æŠ«éœ²ã€ä¿®æ”¹è®°å½•
```

**ğŸ”¸ å›½å†…åˆè§„è¦æ±‚**

```
ç½‘ç»œå®‰å…¨æ³•ï¼š
ğŸ‡¨ğŸ‡³ é€‚ç”¨ï¼šæ‰€æœ‰ç½‘ç»œè¿è¥è€…
ğŸ¯ è¦æ±‚ï¼šç½‘ç»œæ—¥å¿—ä¿å­˜ä¸å°‘äºå…­ä¸ªæœˆ
â° ä¿ç•™ï¼š6ä¸ªæœˆä»¥ä¸Šç½‘ç»œæ—¥å¿—
ğŸ” é‡ç‚¹ï¼šç½‘ç»œè®¿é—®ã€æ•°æ®å¤„ç†ã€å®‰å…¨äº‹ä»¶

æ•°æ®å®‰å…¨æ³•ï¼š
ğŸ“Š é€‚ç”¨ï¼šæ•°æ®å¤„ç†è€…
ğŸ¯ è¦æ±‚ï¼šé‡è¦æ•°æ®å¤„ç†æ´»åŠ¨è®°å½•
â° ä¿ç•™ï¼šæŒ‰é‡è¦æ€§åˆ†çº§ä¿å­˜
ğŸ” é‡ç‚¹ï¼šæ•°æ®æ”¶é›†ã€ä½¿ç”¨ã€å…±äº«ã€åˆ é™¤

ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ï¼š
ğŸ‘¤ é€‚ç”¨ï¼šä¸ªäººä¿¡æ¯å¤„ç†è€…
ğŸ¯ è¦æ±‚ï¼šä¸ªäººä¿¡æ¯å¤„ç†æ´»åŠ¨è®°å½•
â° ä¿ç•™ï¼šå¤„ç†ç›®çš„æ¶ˆå¤±ååŠæ—¶åˆ é™¤
ğŸ” é‡ç‚¹ï¼šæ”¶é›†ã€ä½¿ç”¨ã€å…±äº«ä¸ªäººä¿¡æ¯
```

### 8.2 å®¡è®¡æ—¥å¿—æ ‡å‡†æ ¼å¼


**æ ‡å‡†å®¡è®¡æ—¥å¿—åº”åŒ…å«çš„è¦ç´ **

ä¸€æ¡å®Œæ•´çš„å®¡è®¡æ—¥å¿—å°±åƒä¸€ä»½å®Œæ•´çš„"æ¡ˆå‘ç°åœºè®°å½•"ï¼Œå¿…é¡»å›ç­”ï¼šè°ã€åœ¨ä»€ä¹ˆæ—¶å€™ã€åœ¨å“ªé‡Œã€åšäº†ä»€ä¹ˆã€ç»“æœå¦‚ä½•ã€‚

```
æ ‡å‡†å®¡è®¡æ—¥å¿—æ ¼å¼ï¼š
æ—¶é—´æˆ³ | ç”¨æˆ·èº«ä»½ | æºIPåœ°å€ | æ“ä½œç±»å‹ | æ“ä½œå¯¹è±¡ | æ“ä½œç»“æœ | è¯¦ç»†æè¿°

ç¤ºä¾‹ï¼š
2023-09-19 10:30:15 | admin@company.com | 192.168.1.100 | LOGIN | SYSTEM | SUCCESS | ç”¨æˆ·ç™»å½•æˆåŠŸ
2023-09-19 10:31:22 | admin@company.com | 192.168.1.100 | FILE_ACCESS | /etc/passwd | SUCCESS | æŸ¥çœ‹ç”¨æˆ·æ–‡ä»¶
2023-09-19 10:32:05 | admin@company.com | 192.168.1.100 | USER_CREATE | newuser | SUCCESS | åˆ›å»ºæ–°ç”¨æˆ·
2023-09-19 10:35:10 | admin@company.com | 192.168.1.100 | LOGOUT | SYSTEM | SUCCESS | ç”¨æˆ·æ³¨é”€
```

**rsyslogå®¡è®¡æ—¥å¿—é…ç½®**ï¼š

```bash
# /etc/rsyslog.d/audit.conf
# å®¡è®¡æ—¥å¿—ä¸“ç”¨é…ç½®

# å®šä¹‰å®¡è®¡æ—¥å¿—æ ¼å¼æ¨¡æ¿
$template AuditLogFormat,"%timestamp% | %programname% | %fromhost-ip% | %syslogtag% | %msg%\n"

# å®¡è®¡æ—¥å¿—åˆ†ç±»å­˜å‚¨
auth,authpriv.*                 /var/log/auth_audit.log;AuditLogFormat
kern.*                          /var/log/kernel_audit.log;AuditLogFormat
mail.*                          /var/log/mail_audit.log;AuditLogFormat

# é‡è¦å®¡è®¡æ—¥å¿—åŒæ—¶å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨
*.crit                          $$audit-server.company.com:514

# åœæ­¢è¿›ä¸€æ­¥å¤„ç†å·²åŒ¹é…çš„æ—¥å¿—
& stop
```

### 8.3 å®¡è®¡ç­–ç•¥é…ç½®


**Linux auditdå®¡è®¡é…ç½®**

auditdæ˜¯Linuxç³»ç»Ÿä¸“é—¨çš„å®¡è®¡å®ˆæŠ¤è¿›ç¨‹ï¼Œå¯ä»¥è®°å½•ç³»ç»Ÿè°ƒç”¨çº§åˆ«çš„æ“ä½œã€‚

```bash
# /etc/audit/rules.d/audit.rules
# å®¡è®¡è§„åˆ™é…ç½®

# åˆ é™¤æ‰€æœ‰ç°æœ‰è§„åˆ™
-D

# è®¾ç½®ç¼“å†²åŒºå¤§å°
-b 1024

# ç›‘æ§ç³»ç»Ÿè°ƒç”¨å¤±è´¥
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change
-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change

# ç›‘æ§ç”¨æˆ·å’Œç»„ç®¡ç†
-w /etc/group -p wa -k identity
-w /etc/passwd -p wa -k identity
-w /etc/gshadow -p wa -k identity
-w /etc/shadow -p wa -k identity

# ç›‘æ§é‡è¦æ–‡ä»¶è®¿é—®
-w /etc/sudoers -p wa -k privilege-escalation
-w /etc/ssh/sshd_config -p wa -k ssh-config
-w /var/log/auth.log -p wa -k auth-logs

# ç›‘æ§ç½‘ç»œé…ç½®å˜æ›´
-a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale
-w /etc/hosts -p wa -k network-config
-w /etc/resolv.conf -p wa -k network-config

# é”å®šè§„åˆ™é…ç½®
-e 2
```

**å¯åŠ¨å’ŒéªŒè¯å®¡è®¡**ï¼š

```bash
# é‡å¯å®¡è®¡æœåŠ¡
systemctl restart auditd

# æŸ¥çœ‹å®¡è®¡çŠ¶æ€
auditctl -s

# æœç´¢å®¡è®¡æ—¥å¿—
ausearch -k identity -ts today
ausearch -m USER_LOGIN -ts recent

# ç”Ÿæˆå®¡è®¡æŠ¥å‘Š
aureport --auth
aureport --failed --summary
```

### 8.4 åˆè§„æ€§æ£€æŸ¥å·¥å…·


**è‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥è„šæœ¬**

```bash
#!/bin/bash
# åˆè§„æ€§æ£€æŸ¥è„šæœ¬

COMPLIANCE_REPORT="/var/log/compliance_check.log"

check_log_permissions() {
    echo "ğŸ” æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™..." >> "$COMPLIANCE_REPORT"
    
    # æ£€æŸ¥å…³é”®æ—¥å¿—æ–‡ä»¶æƒé™
    critical_logs=("/var/log/auth.log" "/var/log/secure" "/var/log/audit/audit.log")
    
    for log in "${critical_logs[@]}"; do
        if [ -f "$log" ]; then
            perms=$(stat -c "%a" "$log")
            owner=$(stat -c "%U:%G" "$log")
            
            # æ£€æŸ¥æƒé™æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼ˆåº”è¯¥æ˜¯600æˆ–640ï¼‰
            if [[ "$perms" =~ ^(600|640)$ ]]; then
                echo "âœ… $log æƒé™æ­£ç¡®: $perms ($owner)" >> "$COMPLIANCE_REPORT"
            else
                echo "âŒ $log æƒé™å¼‚å¸¸: $perms ($owner)" >> "$COMPLIANCE_REPORT"
            fi
        else
            echo "âš ï¸  $log æ–‡ä»¶ä¸å­˜åœ¨" >> "$COMPLIANCE_REPORT"
        fi
    done
}

check_audit_service() {
    echo "ğŸ” æ£€æŸ¥å®¡è®¡æœåŠ¡çŠ¶æ€..." >> "$COMPLIANCE_REPORT"
    
    if systemctl is-active --quiet auditd; then
        echo "âœ… auditd æœåŠ¡æ­£åœ¨è¿è¡Œ" >> "$COMPLIANCE_REPORT"
        
        # æ£€æŸ¥å®¡è®¡è§„åˆ™
        rule_count=$(auditctl -l | wc -l)
        echo "ğŸ“Š å½“å‰å®¡è®¡è§„åˆ™æ•°é‡: $rule_count" >> "$COMPLIANCE_REPORT"
        
        if [ "$rule_count" -gt 0 ]; then
            echo "âœ… å®¡è®¡è§„åˆ™é…ç½®æ­£å¸¸" >> "$COMPLIANCE_REPORT"
        else
            echo "âš ï¸  æœªå‘ç°å®¡è®¡è§„åˆ™" >> "$COMPLIANCE_REPORT"
        fi
    else
        echo "âŒ auditd æœåŠ¡æœªè¿è¡Œ" >> "$COMPLIANCE_REPORT"
    fi
}

check_log_retention() {
    echo "ğŸ” æ£€æŸ¥æ—¥å¿—ä¿ç•™ç­–ç•¥..." >> "$COMPLIANCE_REPORT"
    
    # æ£€æŸ¥æ—¥å¿—æ–‡ä»¶çš„æœ€æ—©æ—¶é—´
    oldest_log=$(find /var/log -name "*.log" -type f -printf '%T@ %p\n' | sort -n | head -1)
    if [ -n "$oldest_log" ]; then
        oldest_date=$(echo "$oldest_log" | awk '{print $1}' | xargs -I {} date -d @{} '+%Y-%m-%d')
        days_old=$(( ($(date +%s) - $(echo "$oldest_log" | awk '{print $1}')) / 86400 ))
        
        echo "ğŸ“… æœ€æ—§æ—¥å¿—æ–‡ä»¶æ—¥æœŸ: $oldest_date (${days_old}å¤©å‰)" >> "$COMPLIANCE_REPORT"
        
        # æ£€æŸ¥æ˜¯å¦æ»¡è¶³æœ€å°ä¿ç•™æœŸè¦æ±‚ï¼ˆå‡è®¾180å¤©ï¼‰
        if [ "$days_old" -ge 180 ]; then
            echo "âœ… æ—¥å¿—ä¿ç•™æœŸæ»¡è¶³è¦æ±‚ (â‰¥180å¤©)" >> "$COMPLIANCE_REPORT"
        else
            echo "âš ï¸  æ—¥å¿—ä¿ç•™æœŸå¯èƒ½ä¸è¶³" >> "$COMPLIANCE_REPORT"
        fi
    fi
}

# æ‰§è¡Œåˆè§„æ€§æ£€æŸ¥
echo "ğŸ“‹ åˆè§„æ€§æ£€æŸ¥æŠ¥å‘Š - $(date)" > "$COMPLIANCE_REPORT"
echo "===============================================" >> "$COMPLIANCE_REPORT"

check_log_permissions
check_audit_service  
check_log_retention

echo "âœ… åˆè§„æ€§æ£€æŸ¥å®Œæˆï¼ŒæŠ¥å‘Šå·²ä¿å­˜åˆ° $COMPLIANCE_REPORT"
```

---

## 9. ğŸš¨ æ—¥å¿—å®‰å…¨äº‹ä»¶å“åº”


### 9.1 å®‰å…¨äº‹ä»¶åˆ†ç±»


**ä»€ä¹ˆæ˜¯æ—¥å¿—å®‰å…¨äº‹ä»¶**ï¼Ÿå°±æ˜¯æ—¥å¿—ç³»ç»Ÿå‘ç”Ÿçš„å¼‚å¸¸æƒ…å†µï¼Œå¯èƒ½æš´éœ²ç³»ç»Ÿå­˜åœ¨å®‰å…¨é£é™©ã€‚å°±åƒå®¶é‡Œçš„çƒŸé›¾æŠ¥è­¦å™¨å“äº†ï¼Œè¯´æ˜å¯èƒ½æœ‰ç«ç¾é£é™©ã€‚

**ğŸ”¸ å¸¸è§å®‰å…¨äº‹ä»¶ç±»å‹**

```
æ—¥å¿—å¼‚å¸¸äº‹ä»¶ï¼š
ğŸš¨ æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤æˆ–ç¯¡æ”¹
ğŸš¨ æ—¥å¿—æœåŠ¡åœæ­¢è¿è¡Œ  
ğŸš¨ æ—¥å¿—ç£ç›˜ç©ºé—´è€—å°½
ğŸš¨ æ—¥å¿—ä¼ è¾“ä¸­æ–­

è®¿é—®å¼‚å¸¸äº‹ä»¶ï¼š
ğŸ‘¤ å¼‚å¸¸æ—¶é—´è®¿é—®æ—¥å¿—
ğŸ‘¤ æœªæˆæƒç”¨æˆ·æŸ¥çœ‹æ•æ„Ÿæ—¥å¿—
ğŸ‘¤ æ‰¹é‡ä¸‹è½½æ—¥å¿—æ–‡ä»¶
ğŸ‘¤ ä½¿ç”¨å¼‚å¸¸å·¥å…·è®¿é—®æ—¥å¿—

å†…å®¹å¼‚å¸¸äº‹ä»¶ï¼š
âš ï¸  å¤§é‡é”™è¯¯æ—¥å¿—çªç„¶å‡ºç°
âš ï¸  æ•æ„Ÿä¿¡æ¯æœªè„±æ•è®°å½•
âš ï¸  å¯ç–‘çš„ç™»å½•å¤±è´¥è®°å½•
âš ï¸  å¼‚å¸¸çš„ç³»ç»Ÿè°ƒç”¨è®°å½•
```

### 9.2 äº‹ä»¶æ£€æµ‹æœºåˆ¶


**å®æ—¶å¼‚å¸¸æ£€æµ‹è„šæœ¬**

```bash
#!/bin/bash
# æ—¥å¿—å®‰å…¨äº‹ä»¶å®æ—¶æ£€æµ‹

LOG_MONITOR_DIR="/var/log"
ALERT_LOG="/var/log/security_alerts.log"
THRESHOLD_ERROR_COUNT=100    # é”™è¯¯æ—¥å¿—é˜ˆå€¼
THRESHOLD_FAILED_LOGIN=10    # ç™»å½•å¤±è´¥é˜ˆå€¼

detect_log_tampering() {
    # æ£€æµ‹æ—¥å¿—æ–‡ä»¶ç¯¡æ”¹
    echo "ğŸ” æ£€æµ‹æ—¥å¿—æ–‡ä»¶å®Œæ•´æ€§..."
    
    # æ£€æŸ¥å…³é”®æ—¥å¿—æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´
    critical_logs=("/var/log/auth.log" "/var/log/secure" "/var/log/messages")
    
    for log in "${critical_logs[@]}"; do
        if [ -f "$log" ]; then
            # è·å–æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´
            last_modified=$(stat -c %Y "$log")
            current_time=$(date +%s)
            time_diff=$((current_time - last_modified))
            
            # å¦‚æœæ ¸å¿ƒæ—¥å¿—æ–‡ä»¶è¶…è¿‡10åˆ†é’Ÿæ²¡æœ‰æ›´æ–°ï¼Œå¯èƒ½å¼‚å¸¸
            if [ "$time_diff" -gt 600 ]; then
                echo "âš ï¸  $(date): æ—¥å¿—æ–‡ä»¶ $log è¶…è¿‡10åˆ†é’Ÿæœªæ›´æ–°" >> "$ALERT_LOG"
                send_alert "æ—¥å¿—æ–‡ä»¶å¼‚å¸¸" "$log å¯èƒ½å·²åœæ­¢æ›´æ–°"
            fi
        else
            echo "ğŸš¨ $(date): å…³é”®æ—¥å¿—æ–‡ä»¶ $log ä¸å­˜åœ¨ï¼" >> "$ALERT_LOG"
            send_alert "æ—¥å¿—æ–‡ä»¶ä¸¢å¤±" "$log æ–‡ä»¶ä¸å­˜åœ¨"
        fi
    done
}

detect_abnormal_errors() {
    # æ£€æµ‹å¼‚å¸¸é”™è¯¯æ—¥å¿—
    echo "ğŸ” æ£€æµ‹å¼‚å¸¸é”™è¯¯æ¨¡å¼..."
    
    # ç»Ÿè®¡æœ€è¿‘1å°æ—¶çš„é”™è¯¯æ—¥å¿—æ•°é‡
    error_count=$(journalctl --since "1 hour ago" --priority=err | wc -l)
    
    if [ "$error_count" -gt "$THRESHOLD_ERROR_COUNT" ]; then
        echo "ğŸš¨ $(date): æ£€æµ‹åˆ°å¼‚å¸¸å¤§é‡é”™è¯¯æ—¥å¿— ($error_count æ¡)" >> "$ALERT_LOG"
        send_alert "å¼‚å¸¸é”™è¯¯å‘Šè­¦" "1å°æ—¶å†…äº§ç”Ÿ $error_count æ¡é”™è¯¯æ—¥å¿—"
    fi
}

detect_failed_logins() {
    # æ£€æµ‹ç™»å½•å¤±è´¥æ”»å‡»
    echo "ğŸ” æ£€æµ‹ç™»å½•å¤±è´¥æ¨¡å¼..."
    
    # ç»Ÿè®¡æœ€è¿‘10åˆ†é’Ÿçš„ç™»å½•å¤±è´¥æ¬¡æ•°
    failed_logins=$(journalctl --since "10 minutes ago" | grep -i "failed\|failure" | grep -i "login\|ssh" | wc -l)
    
    if [ "$failed_logins" -gt "$THRESHOLD_FAILED_LOGIN" ]; then
        echo "ğŸš¨ $(date): æ£€æµ‹åˆ°å¯ç–‘ç™»å½•å¤±è´¥ ($failed_logins æ¬¡)" >> "$ALERT_LOG"
        
        # è·å–å¤±è´¥ç™»å½•çš„IPåœ°å€
        suspicious_ips=$(journalctl --since "10 minutes ago" | grep -i "failed.*ssh" | grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}' | sort | uniq -c | sort -nr)
        
        send_alert "ç™»å½•å¤±è´¥æ”»å‡»" "æ£€æµ‹åˆ° $failed_logins æ¬¡ç™»å½•å¤±è´¥ï¼Œå¯ç–‘IPï¼š$suspicious_ips"
    fi
}

send_alert() {
    local alert_type="$1"
    local alert_message="$2"
    
    # è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—
    logger -p security.crit "[$alert_type] $alert_message"
    
    # å‘é€é‚®ä»¶å‘Šè­¦ï¼ˆå¦‚æœé…ç½®äº†é‚®ä»¶ç³»ç»Ÿï¼‰
    if command -v mail >/dev/null 2>&1; then
        echo "$alert_message" | mail -s "[$alert_type] å®‰å…¨å‘Šè­¦" admin@company.com
    fi
    
    # å‘é€åˆ°è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨
    echo "$(date): [$alert_type] $alert_message" | logger -n log-server.company.com -P 514
}

# æ‰§è¡Œæ£€æµ‹
detect_log_tampering
detect_abnormal_errors
detect_failed_logins
```

### 9.3 è‡ªåŠ¨åŒ–å“åº”æœºåˆ¶


**äº‹ä»¶è‡ªåŠ¨å“åº”è„šæœ¬**

```bash
#!/bin/bash
# å®‰å…¨äº‹ä»¶è‡ªåŠ¨å“åº”å¤„ç†

INCIDENT_LOG="/var/log/incident_response.log"
QUARANTINE_DIR="/var/quarantine"

respond_to_tampering() {
    local affected_file="$1"
    
    echo "ğŸš¨ $(date): å“åº”æ—¥å¿—ç¯¡æ”¹äº‹ä»¶ - $affected_file" >> "$INCIDENT_LOG"
    
    # 1. ç«‹å³å¤‡ä»½å½“å‰çŠ¶æ€
    backup_file="$QUARANTINE_DIR/$(basename "$affected_file").$(date +%s).backup"
    cp "$affected_file" "$backup_file" 2>/dev/null
    
    # 2. æ¢å¤æœ€è¿‘çš„å®Œæ•´å¤‡ä»½
    if [ -f "/backup/logs/$(basename "$affected_file")" ]; then
        cp "/backup/logs/$(basename "$affected_file")" "$affected_file"
        echo "âœ… å·²ä»å¤‡ä»½æ¢å¤æ–‡ä»¶: $affected_file" >> "$INCIDENT_LOG"
    fi
    
    # 3. åŠ å¼ºæ–‡ä»¶ä¿æŠ¤
    chattr +a "$affected_file"  # è®¾ç½®åªèƒ½è¿½åŠ å±æ€§
    chmod 600 "$affected_file"  # é™åˆ¶è®¿é—®æƒé™
    
    # 4. è®°å½•äº‹ä»¶è¯¦æƒ…
    echo "ç¯¡æ”¹æ£€æµ‹æ—¶é—´: $(date)" >> "$INCIDENT_LOG"
    echo "å—å½±å“æ–‡ä»¶: $affected_file" >> "$INCIDENT_LOG"
    echo "å¤‡ä»½ä½ç½®: $backup_file" >> "$INCIDENT_LOG"
    echo "å“åº”æªæ–½: æ¢å¤å¤‡ä»½,åŠ å¼ºä¿æŠ¤" >> "$INCIDENT_LOG"
    echo "---" >> "$INCIDENT_LOG"
}

respond_to_failed_logins() {
    local suspicious_ip="$1"
    local fail_count="$2"
    
    echo "ğŸš¨ $(date): å“åº”ç™»å½•å¤±è´¥æ”»å‡» - IP: $suspicious_ip, æ¬¡æ•°: $fail_count" >> "$INCIDENT_LOG"
    
    # 1. ä¸´æ—¶å°ç¦IPåœ°å€
    if command -v iptables >/dev/null 2>&1; then
        iptables -A INPUT -s "$suspicious_ip" -j DROP
        echo "ğŸ›¡ï¸  å·²ä¸´æ—¶å°ç¦IP: $suspicious_ip" >> "$INCIDENT_LOG"
        
        # è®¾ç½®è‡ªåŠ¨è§£å°ï¼ˆ24å°æ—¶åï¼‰
        echo "iptables -D INPUT -s $suspicious_ip -j DROP" | at now + 24 hours
    fi
    
    # 2. å¢å¼ºSSHé…ç½®
    if [ -f "/etc/ssh/sshd_config" ]; then
        # ä¸´æ—¶é™ä½æœ€å¤§è®¤è¯å°è¯•æ¬¡æ•°
        sed -i 's/^#*MaxAuthTries.*/MaxAuthTries 3/' /etc/ssh/sshd_config
        systemctl reload sshd
        echo "ğŸ”’ å·²ä¸´æ—¶åŠ å¼ºSSHå®‰å…¨é…ç½®" >> "$INCIDENT_LOG"
    fi
    
    # 3. è®°å½•æ”»å‡»è¯¦æƒ…
    echo "æ”»å‡»æ—¶é—´: $(date)" >> "$INCIDENT_LOG"
    echo "æ”»å‡»æºIP: $suspicious_ip" >> "$INCIDENT_LOG"
    echo "å¤±è´¥æ¬¡æ•°: $fail_count" >> "$INCIDENT_LOG"
    echo "å“åº”æªæ–½: IPå°ç¦,SSHåŠ å›º" >> "$INCIDENT_LOG"
    echo "---" >> "$INCIDENT_LOG"
}

# åˆ›å»ºéš”ç¦»ç›®å½•
mkdir -p "$QUARANTINE_DIR"

# ç¤ºä¾‹ï¼šå“åº”ä¸åŒç±»å‹çš„å®‰å…¨äº‹ä»¶
case "$1" in
    "tampering")
        respond_to_tampering "$2"
        ;;
    "failed_login")
        respond_to_failed_logins "$2" "$3"
        ;;
    *)
        echo "ç”¨æ³•: $0 {tampering|failed_login} [å‚æ•°...]"
        exit 1
        ;;
esac
```

### 9.4 äº‹ä»¶è°ƒæŸ¥å–è¯


**æ—¥å¿—å–è¯åˆ†æå·¥å…·**

```bash
#!/bin/bash
# æ—¥å¿—å–è¯åˆ†æå·¥å…·

EVIDENCE_DIR="/var/evidence/$(date +%Y%m%d_%H%M%S)"
CASE_LOG="$EVIDENCE_DIR/investigation.log"

collect_evidence() {
    local incident_time="$1"
    local incident_type="$2"
    
    echo "ğŸ” å¼€å§‹æ”¶é›†è¯æ® - äº‹ä»¶ç±»å‹: $incident_type, æ—¶é—´: $incident_time"
    
    # åˆ›å»ºè¯æ®ç›®å½•
    mkdir -p "$EVIDENCE_DIR"
    
    echo "ğŸ“‹ æ—¥å¿—å–è¯æŠ¥å‘Š" > "$CASE_LOG"
    echo "äº‹ä»¶æ—¶é—´: $incident_time" >> "$CASE_LOG"
    echo "äº‹ä»¶ç±»å‹: $incident_type" >> "$CASE_LOG"
    echo "è°ƒæŸ¥æ—¶é—´: $(date)" >> "$CASE_LOG"
    echo "è°ƒæŸ¥äººå‘˜: $(whoami)" >> "$CASE_LOG"
    echo "===============================================" >> "$CASE_LOG"
    
    # 1. æ”¶é›†ç³»ç»ŸçŠ¶æ€å¿«ç…§
    echo "ğŸ–¥ï¸  æ”¶é›†ç³»ç»ŸçŠ¶æ€..." >> "$CASE_LOG"
    ps aux > "$EVIDENCE_DIR/process_snapshot.txt"
    netstat -tulpn > "$EVIDENCE_DIR/network_connections.txt"
    who > "$EVIDENCE_DIR/active_users.txt"
    
    # 2. æ”¶é›†ç›¸å…³æ—¥å¿—
    echo "ğŸ“ æ”¶é›†ç›¸å…³æ—¥å¿—..." >> "$CASE_LOG"
    
    # ç³»ç»Ÿæ—¥å¿—
    journalctl --since="$incident_time" --until="$(date)" > "$EVIDENCE_DIR/system_logs.txt"
    
    # è®¤è¯æ—¥å¿—
    grep "$incident_time" /var/log/auth.log > "$EVIDENCE_DIR/auth_logs.txt" 2>/dev/null
    
    # å®¡è®¡æ—¥å¿—
    ausearch -ts "$incident_time" > "$EVIDENCE_DIR/audit_logs.txt" 2>/dev/null
    
    # 3. æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
    echo "ğŸ” æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§..." >> "$CASE_LOG"
    find /var/log -type f -name "*.log" -exec md5sum {} \; > "$EVIDENCE_DIR/file_hashes.txt"
    
    # 4. ç½‘ç»œè¿æ¥åˆ†æ
    echo "ğŸŒ åˆ†æç½‘ç»œæ´»åŠ¨..." >> "$CASE_LOG"
    if [ -f "/var/log/messages" ]; then
        grep -E "(IP|ip)" /var/log/messages | grep "$incident_time" > "$EVIDENCE_DIR/network_activity.txt"
    fi
    
    # 5. ç”¨æˆ·æ´»åŠ¨åˆ†æ
    echo "ğŸ‘¤ åˆ†æç”¨æˆ·æ´»åŠ¨..." >> "$CASE_LOG"
    last -F | head -50 > "$EVIDENCE_DIR/user_sessions.txt"
    lastlog > "$EVIDENCE_DIR/last_logins.txt"
    
    # 6. ç”Ÿæˆå–è¯æ‘˜è¦
    echo "" >> "$CASE_LOG"
    echo "ğŸ“Š è¯æ®æ”¶é›†æ‘˜è¦:" >> "$CASE_LOG"
    echo "- è¿›ç¨‹å¿«ç…§: $(wc -l < "$EVIDENCE_DIR/process_snapshot.txt") æ¡è®°å½•" >> "$CASE_LOG"
    echo "- ç½‘ç»œè¿æ¥: $(wc -l < "$EVIDENCE_DIR/network_connections.txt") æ¡è®°å½•" >> "$CASE_LOG"
    echo "- ç³»ç»Ÿæ—¥å¿—: $(wc -l < "$EVIDENCE_DIR/system_logs.txt") æ¡è®°å½•" >> "$CASE_LOG"
    echo "- æ–‡ä»¶å“ˆå¸Œ: $(wc -l < "$EVIDENCE_DIR/file_hashes.txt") ä¸ªæ–‡ä»¶" >> "$CASE_LOG"
    
    echo "âœ… è¯æ®æ”¶é›†å®Œæˆï¼Œä¿å­˜åœ¨: $EVIDENCE_DIR"
}

analyze_attack_pattern() {
    local log_file="$1"
    
    echo "ğŸ”¬ åˆ†ææ”»å‡»æ¨¡å¼..."
    
    # åˆ†æIPåœ°å€æ¨¡å¼
    echo "ğŸ“Š æ”»å‡»IPç»Ÿè®¡:" >> "$CASE_LOG"
    grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}' "$log_file" | sort | uniq -c | sort -nr | head -10 >> "$CASE_LOG"
    
    # åˆ†ææ—¶é—´æ¨¡å¼
    echo "" >> "$CASE_LOG"
    echo "â° æ”»å‡»æ—¶é—´åˆ†å¸ƒ:" >> "$CASE_LOG"
    grep -E "failed|Failed|FAILED" "$log_file" | cut -d' ' -f1-3 | sort | uniq -c >> "$CASE_LOG"
    
    # åˆ†ææ”»å‡»æ–¹æ³•
    echo "" >> "$CASE_LOG"
    echo "âš”ï¸ æ”»å‡»æ–¹æ³•åˆ†æ:" >> "$CASE_LOG"
    grep -i -E "(brute|force|scan|exploit)" "$log_file" | head -10 >> "$CASE_LOG"
}

# ä½¿ç”¨ç¤ºä¾‹
if [ $# -eq 2 ]; then
    collect_evidence "$1" "$2"
    
    # å¦‚æœæœ‰ç³»ç»Ÿæ—¥å¿—ï¼Œè¿›è¡Œæ”»å‡»æ¨¡å¼åˆ†æ
    if [ -f "$EVIDENCE_DIR/system_logs.txt" ]; then
        analyze_attack_pattern "$EVIDENCE_DIR/system_logs.txt"
    fi
else
    echo "ç”¨æ³•: $0 <äº‹ä»¶æ—¶é—´> <äº‹ä»¶ç±»å‹>"
    echo "ç¤ºä¾‹: $0 '2023-09-19 10:00:00' 'unauthorized_access'"
fi
```

### 9.5 åº”æ€¥å“åº”æµç¨‹


**æ ‡å‡†åŒ–åº”æ€¥å“åº”æµç¨‹**

```
ğŸ“‹ æ—¥å¿—å®‰å…¨äº‹ä»¶åº”æ€¥å“åº”æµç¨‹

ç¬¬ä¸€é˜¶æ®µï¼šæ£€æµ‹ä¸è¯†åˆ« (Detection & Identification)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç›‘æ§ç³»ç»Ÿå‘ç°å¼‚å¸¸                      â”‚
â”‚ 2. åˆæ­¥åˆ¤æ–­äº‹ä»¶ç±»å‹å’Œä¸¥é‡ç¨‹åº¦             â”‚
â”‚ 3. ç¡®è®¤æ˜¯å¦ä¸ºçœŸå®å®‰å…¨äº‹ä»¶                 â”‚
â”‚ 4. å¯åŠ¨åº”æ€¥å“åº”æµç¨‹                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
ç¬¬äºŒé˜¶æ®µï¼šéåˆ¶ä¸éš”ç¦» (Containment & Isolation)  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. éš”ç¦»å—å½±å“çš„ç³»ç»Ÿå’ŒæœåŠ¡                 â”‚
â”‚ 2. é˜»æ­¢å¨èƒè¿›ä¸€æ­¥æ‰©æ•£                     â”‚
â”‚ 3. ä¿æŠ¤å…³é”®æ—¥å¿—æ•°æ®                       â”‚
â”‚ 4. å»ºç«‹å¤‡ç”¨æ—¥å¿—è®°å½•æœºåˆ¶                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
ç¬¬ä¸‰é˜¶æ®µï¼šæ ¹é™¤ä¸æ¢å¤ (Eradication & Recovery)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ¸…é™¤å¨èƒæ¥æº                           â”‚
â”‚ 2. ä¿®å¤å—æŸçš„æ—¥å¿—ç³»ç»Ÿ                     â”‚
â”‚ 3. æ¢å¤æ­£å¸¸æ—¥å¿—æœåŠ¡                       â”‚
â”‚ 4. éªŒè¯ç³»ç»Ÿå®‰å…¨æ€§                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
ç¬¬å››é˜¶æ®µï¼šç»éªŒæ€»ç»“ (Lessons Learned)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ†æäº‹ä»¶æ ¹æœ¬åŸå›                        â”‚
â”‚ 2. è¯„ä¼°å“åº”æ•ˆæœ                           â”‚
â”‚ 3. æ›´æ–°å®‰å…¨ç­–ç•¥                           â”‚
â”‚ 4. æ”¹è¿›ç›‘æ§å’Œé˜²æŠ¤æªæ–½                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åº”æ€¥å“åº”æ‰§è¡Œè„šæœ¬**ï¼š

```bash
#!/bin/bash
# æ—¥å¿—å®‰å…¨åº”æ€¥å“åº”è‡ªåŠ¨åŒ–è„šæœ¬

INCIDENT_ID="INC_$(date +%Y%m%d_%H%M%S)"
RESPONSE_LOG="/var/log/incident_response_$INCIDENT_ID.log"
BACKUP_DIR="/var/backup/emergency"

emergency_response() {
    local incident_type="$1"
    local severity="$2"  # LOW, MEDIUM, HIGH, CRITICAL
    
    echo "ğŸš¨ å¯åŠ¨åº”æ€¥å“åº” - äº‹ä»¶ID: $INCIDENT_ID" | tee -a "$RESPONSE_LOG"
    echo "äº‹ä»¶ç±»å‹: $incident_type" | tee -a "$RESPONSE_LOG"
    echo "ä¸¥é‡ç¨‹åº¦: $severity" | tee -a "$RESPONSE_LOG"
    echo "å“åº”æ—¶é—´: $(date)" | tee -a "$RESPONSE_LOG"
    echo "========================================" | tee -a "$RESPONSE_LOG"
    
    # ç¬¬ä¸€é˜¶æ®µï¼šæ£€æµ‹ä¸è¯†åˆ«
    stage1_detection
    
    # ç¬¬äºŒé˜¶æ®µï¼šéåˆ¶ä¸éš”ç¦»
    stage2_containment "$severity"
    
    # ç¬¬ä¸‰é˜¶æ®µï¼šæ ¹é™¤ä¸æ¢å¤
    stage3_recovery
    
    # ç”Ÿæˆå“åº”æŠ¥å‘Š
    generate_incident_report
}

stage1_detection() {
    echo "ğŸ” ç¬¬ä¸€é˜¶æ®µï¼šæ£€æµ‹ä¸è¯†åˆ«" | tee -a "$RESPONSE_LOG"
    
    # æ”¶é›†ç³»ç»ŸçŠ¶æ€ä¿¡æ¯
    ps aux > "$BACKUP_DIR/process_state_$INCIDENT_ID.txt"
    netstat -tulpn > "$BACKUP_DIR/network_state_$INCIDENT_ID.txt"
    
    # æ£€æŸ¥æ—¥å¿—æœåŠ¡çŠ¶æ€
    systemctl status rsyslog >> "$RESPONSE_LOG"
    systemctl status auditd >> "$RESPONSE_LOG"
    
    echo "âœ… ç¬¬ä¸€é˜¶æ®µå®Œæˆ" | tee -a "$RESPONSE_LOG"
}

stage2_containment() {
    local severity="$1"
    
    echo "ğŸ›¡ï¸ ç¬¬äºŒé˜¶æ®µï¼šéåˆ¶ä¸éš”ç¦»" | tee -a "$RESPONSE_LOG"
    
    # æ ¹æ®ä¸¥é‡ç¨‹åº¦é‡‡å–ä¸åŒæªæ–½
    case "$severity" in
        "CRITICAL")
            # ç´§æ€¥å¤‡ä»½æ‰€æœ‰æ—¥å¿—
            tar -czf "$BACKUP_DIR/emergency_logs_$INCIDENT_ID.tar.gz" /var/log/
            
            # å¯ç”¨åªè¯»æ¨¡å¼ä¿æŠ¤å…³é”®æ—¥å¿—
            critical_logs=("/var/log/auth.log" "/var/log/secure" "/var/log/messages")
            for log in "${critical_logs[@]}"; do
                [ -f "$log" ] && chattr +i "$log"
            done
            echo "ğŸ”’ å·²å¯ç”¨å…³é”®æ—¥å¿—åªè¯»ä¿æŠ¤" | tee -a "$RESPONSE_LOG"
            ;;
        "HIGH")
            # å¢å¼ºç›‘æ§
            inotifywait -m /var/log -e create,delete,modify --format '%w%f %e %T' --timefmt '%Y-%m-%d %H:%M:%S' &
            echo "ğŸ‘ï¸ å·²å¯ç”¨å¢å¼ºæ—¥å¿—ç›‘æ§" | tee -a "$RESPONSE_LOG"
            ;;
        "MEDIUM"|"LOW")
            # å¢åŠ æ—¥å¿—å¤‡ä»½é¢‘ç‡
            rsync -av /var/log/ "$BACKUP_DIR/logs_$INCIDENT_ID/"
            echo "ğŸ“ å·²æ‰§è¡Œæ—¥å¿—å¤‡ä»½" | tee -a "$RESPONSE_LOG"
            ;;
    esac
    
    echo "âœ… ç¬¬äºŒé˜¶æ®µå®Œæˆ" | tee -a "$RESPONSE_LOG"
}

stage3_recovery() {
    echo "ğŸ”§ ç¬¬ä¸‰é˜¶æ®µï¼šæ ¹é™¤ä¸æ¢å¤" | tee -a "$RESPONSE_LOG"
    
    # æ£€æŸ¥å¹¶æ¢å¤æ—¥å¿—æœåŠ¡
    if ! systemctl is-active --quiet rsyslog; then
        systemctl restart rsyslog
        echo "ğŸ”„ å·²é‡å¯rsyslogæœåŠ¡" | tee -a "$RESPONSE_LOG"
    fi
    
    if ! systemctl is-active --quiet auditd; then
        systemctl restart auditd
        echo "ğŸ”„ å·²é‡å¯auditdæœåŠ¡" | tee -a "$RESPONSE_LOG"
    fi
    
    # éªŒè¯æ—¥å¿—åŠŸèƒ½
    test_message="æµ‹è¯•æ—¥å¿—åŠŸèƒ½ - $INCIDENT_ID"
    logger "$test_message"
    
    if grep -q "$test_message" /var/log/messages; then
        echo "âœ… æ—¥å¿—åŠŸèƒ½éªŒè¯æˆåŠŸ" | tee -a "$RESPONSE_LOG"
    else
        echo "âŒ æ—¥å¿—åŠŸèƒ½éªŒè¯å¤±è´¥" | tee -a "$RESPONSE_LOG"
    fi
    
    echo "âœ… ç¬¬ä¸‰é˜¶æ®µå®Œæˆ" | tee -a "$RESPONSE_LOG"
}

generate_incident_report() {
    echo "ğŸ“‹ ç”Ÿæˆäº‹ä»¶å“åº”æŠ¥å‘Š" | tee -a "$RESPONSE_LOG"
    
    cat << EOF >> "$RESPONSE_LOG"

========== äº‹ä»¶å“åº”æ€»ç»“ ==========
äº‹ä»¶ID: $INCIDENT_ID
å¼€å§‹æ—¶é—´: $(head -1 "$RESPONSE_LOG" | grep -o '[0-9-]* [0-9:]*')
ç»“æŸæ—¶é—´: $(date)
å“åº”æªæ–½: æ£€æµ‹è¯†åˆ« â†’ éåˆ¶éš”ç¦» â†’ æ ¹é™¤æ¢å¤
å¤‡ä»½ä½ç½®: $BACKUP_DIR
çŠ¶æ€: å·²å®Œæˆ

åç»­å»ºè®®:
1. åˆ†æäº‹ä»¶æ ¹æœ¬åŸå› 
2. æ›´æ–°ç›‘æ§è§„åˆ™
3. åŠ å¼ºé¢„é˜²æªæ–½
4. å®šæœŸæ¼”ç»ƒå“åº”æµç¨‹

EOF

    echo "âœ… åº”æ€¥å“åº”å®Œæˆï¼Œè¯¦ç»†æŠ¥å‘Š: $RESPONSE_LOG"
}

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p "$BACKUP_DIR"

# æ‰§è¡Œåº”æ€¥å“åº”
if [ $# -eq 2 ]; then
    emergency_response "$1" "$2"
else
    echo "ç”¨æ³•: $0 <äº‹ä»¶ç±»å‹> <ä¸¥é‡ç¨‹åº¦>"
    echo "ä¸¥é‡ç¨‹åº¦: LOW, MEDIUM, HIGH, CRITICAL"
    echo "ç¤ºä¾‹: $0 'log_tampering' 'HIGH'"
fi
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ—¥å¿—å®‰å…¨æœ¬è´¨ï¼šä¿æŠ¤æ—¥å¿—å®Œæ•´æ€§ã€å¯ç”¨æ€§ã€ä¿å¯†æ€§çš„ç»¼åˆæªæ–½
ğŸ”¸ æƒé™åŠ å›ºï¼šé€šè¿‡æ–‡ä»¶æƒé™ã€ç”¨æˆ·ç»„ã€sudoç­‰æ§åˆ¶æ—¥å¿—è®¿é—®
ğŸ”¸ ç¯¡æ”¹é˜²æŠ¤ï¼šä½¿ç”¨å“ˆå¸Œæ ¡éªŒã€åªè¯»å±æ€§ã€è¿œç¨‹å¤‡ä»½é˜²æ­¢ç¯¡æ”¹
ğŸ”¸ å®æ—¶å¤‡ä»½ï¼šç¡®ä¿é‡è¦æ—¥å¿—æ•°æ®ä¸ä¸¢å¤±çš„å…³é”®ä¿éšœæªæ–½
ğŸ”¸ è„±æ•å¤„ç†ï¼šä¿æŠ¤æ•æ„Ÿä¿¡æ¯ä¸æ³„éœ²çš„é‡è¦æŠ€æœ¯æ‰‹æ®µ
ğŸ”¸ åˆè§„å®¡è®¡ï¼šæ»¡è¶³æ³•è§„è¦æ±‚çš„æ ‡å‡†åŒ–æ—¥å¿—ç®¡ç†æµç¨‹
ğŸ”¸ äº‹ä»¶å“åº”ï¼šå¿«é€Ÿæœ‰æ•ˆå¤„ç†æ—¥å¿—å®‰å…¨äº‹ä»¶çš„æ ‡å‡†åŒ–æµç¨‹
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ—¥å¿—å®‰å…¨çš„ä¸‰å¤§æ”¯æŸ±**
```
æŠ€æœ¯é˜²æŠ¤ï¼š
â€¢ æƒé™æ§åˆ¶ + å®Œæ•´æ€§æ ¡éªŒ + åŠ å¯†ä¼ è¾“
â€¢ å¤šå±‚é˜²æŠ¤ï¼ŒæŠ€æœ¯æ‰‹æ®µç›¸äº’è¡¥å……
â€¢ è‡ªåŠ¨åŒ–ç›‘æ§å’Œå“åº”

ç®¡ç†åˆ¶åº¦ï¼š
â€¢ è®¿é—®æƒé™ç®¡ç† + ä¿ç•™æœŸé™ç­–ç•¥  
â€¢ äººå‘˜èŒè´£åˆ†å·¥ + æ“ä½œæµç¨‹è§„èŒƒ
â€¢ å®šæœŸæ£€æŸ¥å’Œæ›´æ–°

åˆè§„è¦æ±‚ï¼š
â€¢ æ»¡è¶³è¡Œä¸šæ³•è§„ + å®¡è®¡æ ‡å‡†
â€¢ è¯æ®ä¿å…¨ + å–è¯è°ƒæŸ¥
â€¢ æŒç»­æ”¹è¿›å’Œä¼˜åŒ–
```

**ğŸ”¹ é˜²æŠ¤ç­–ç•¥çš„å±‚æ¬¡æ€§**
```
é¢„é˜²å±‚ï¼šæƒé™æ§åˆ¶ã€è„±æ•å¤„ç†ã€å®‰å…¨é…ç½®
æ£€æµ‹å±‚ï¼šå®Œæ•´æ€§æ ¡éªŒã€å¼‚å¸¸ç›‘æ§ã€å®æ—¶å‘Šè­¦  
å“åº”å±‚ï¼šè‡ªåŠ¨éš”ç¦»ã€å¤‡ä»½æ¢å¤ã€äº‹ä»¶å¤„ç†
æ¢å¤å±‚ï¼šç³»ç»Ÿä¿®å¤ã€æœåŠ¡æ¢å¤ã€ç»éªŒæ€»ç»“
```

**ğŸ”¹ å®‰å…¨ä¸å¯ç”¨æ€§çš„å¹³è¡¡**
```
å®‰å…¨è¦æ±‚ï¼šä¸¥æ ¼çš„è®¿é—®æ§åˆ¶å’Œä¿æŠ¤æªæ–½
å¯ç”¨æ€§è¦æ±‚ï¼šä¾¿äºæŸ¥è¯¢åˆ†æå’Œæ•…éšœæ’æŸ¥
å¹³è¡¡ç­–ç•¥ï¼šåˆ†çº§ç®¡ç†ã€æŒ‰éœ€æˆæƒã€æ™ºèƒ½ç›‘æ§
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¼ä¸šå®æ–½å»ºè®®**
- **å°å‹ä¼ä¸š**ï¼šé‡ç‚¹å…³æ³¨åŸºç¡€æƒé™æ§åˆ¶å’Œå®šæœŸå¤‡ä»½
- **ä¸­å‹ä¼ä¸š**ï¼šå»ºç«‹å®Œæ•´çš„æ—¥å¿—å®‰å…¨ç®¡ç†åˆ¶åº¦
- **å¤§å‹ä¼ä¸š**ï¼šå®æ–½å…¨é¢çš„æ—¥å¿—å®‰å…¨é˜²æŠ¤ä½“ç³»
- **ç‰¹æ®Šè¡Œä¸š**ï¼šä¸¥æ ¼æŒ‰ç…§è¡Œä¸šåˆè§„è¦æ±‚å®æ–½

**ğŸ”§ æŠ€æœ¯å®æ–½è¦ç‚¹**
- **å¾ªåºæ¸è¿›**ï¼šä»åŸºç¡€æƒé™åŠ å›ºå¼€å§‹ï¼Œé€æ­¥å®Œå–„
- **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**ï¼šå°½é‡ä½¿ç”¨è„šæœ¬å’Œå·¥å…·è‡ªåŠ¨åŒ–ç®¡ç†
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹æœ‰æ•ˆçš„å¼‚å¸¸æ£€æµ‹å’Œå‘Šè­¦æœºåˆ¶
- **å®šæœŸæ¼”ç»ƒ**ï¼šå®šæœŸæµ‹è¯•åº”æ€¥å“åº”æµç¨‹çš„æœ‰æ•ˆæ€§

**ğŸ“Š æ•ˆæœè¯„ä¼°æ ‡å‡†**
- **æƒé™åˆè§„ç‡**ï¼šæ—¥å¿—æ–‡ä»¶æƒé™é…ç½®çš„æ­£ç¡®æ€§
- **å¤‡ä»½æˆåŠŸç‡**ï¼šæ—¥å¿—å¤‡ä»½çš„å®Œæ•´æ€§å’Œå¯ç”¨æ€§
- **å“åº”æ—¶æ•ˆ**ï¼šå®‰å…¨äº‹ä»¶çš„æ£€æµ‹å’Œå“åº”é€Ÿåº¦
- **åˆè§„è¾¾æ ‡ç‡**ï¼šæ»¡è¶³ç›¸å…³æ³•è§„å’Œæ ‡å‡†çš„ç¨‹åº¦

### 10.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ å¸¸è§å®æ–½é—®é¢˜**
```
æƒé™è¿‡ä¸¥å½±å“ä½¿ç”¨ï¼š
è§£å†³æ–¹æ¡ˆï¼šé‡‡ç”¨åˆ†çº§æˆæƒï¼ŒæŒ‰è§’è‰²åˆ†é…æƒé™

å¤‡ä»½å ç”¨å¤§é‡ç©ºé—´ï¼š  
è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å‹ç¼©å’Œåˆ†å±‚å­˜å‚¨ç­–ç•¥

è„±æ•å½±å“æ—¥å¿—åˆ†æï¼š
è§£å†³æ–¹æ¡ˆï¼šä¿ç•™åˆ†æéœ€è¦çš„å­—æ®µï¼Œåªè„±æ•æ•æ„Ÿéƒ¨åˆ†

ç›‘æ§äº§ç”Ÿå¤§é‡å‘Šè­¦ï¼š
è§£å†³æ–¹æ¡ˆï¼šä¼˜åŒ–å‘Šè­¦è§„åˆ™ï¼Œå‡å°‘è¯¯æŠ¥
```

**ğŸ› ï¸ æœ€ä½³å®è·µç»éªŒ**
- **æƒé™æœ€å°åŒ–**ï¼šåªç»™å¿…è¦çš„æœ€å°æƒé™
- **å¤‡ä»½å¤šæ ·åŒ–**ï¼šæœ¬åœ°å¤‡ä»½ + è¿œç¨‹å¤‡ä»½ + äº‘å¤‡ä»½
- **ç›‘æ§æ™ºèƒ½åŒ–**ï¼šåŸºäºæœºå™¨å­¦ä¹ çš„å¼‚å¸¸æ£€æµ‹
- **å“åº”è‡ªåŠ¨åŒ–**ï¼šæ ‡å‡†åŒ–çš„è‡ªåŠ¨å“åº”æµç¨‹

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ—¥å¿—å®‰å…¨ä¸‰è¦ç´ ï¼Œå®Œæ•´å¯ç”¨ä¿å¯†æ€§
æƒé™åŠ å›ºæ˜¯åŸºç¡€ï¼Œå¤‡ä»½è„±æ•è¦è·Ÿä¸Š
ç›‘æ§å‘Šè­¦ä¸èƒ½å°‘ï¼Œåº”æ€¥å“åº”è¦åŠæ—¶
åˆè§„å®¡è®¡æ˜¯åº•çº¿ï¼ŒæŒç»­æ”¹è¿›ä¿å®‰å…¨
```

è¿™æ ·çš„æ—¥å¿—å®‰å…¨ä¸å®¡è®¡ä½“ç³»èƒ½å¤Ÿæœ‰æ•ˆä¿æŠ¤ä¼ä¸šçš„æ•°å­—èµ„äº§ï¼Œæ»¡è¶³åˆè§„è¦æ±‚ï¼Œä¸ºä¸šåŠ¡å‘å±•æä¾›åšå®çš„å®‰å…¨ä¿éšœã€‚è®°ä½ï¼Œæ—¥å¿—å®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§å·¥ç¨‹ï¼Œéœ€è¦æŒç»­ç»´æŠ¤å’Œæ”¹è¿›ã€‚