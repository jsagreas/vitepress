---
title: 5ã€systemd-resolvedæœåŠ¡
---
## ğŸ“š ç›®å½•

1. [systemd-resolvedæœåŠ¡æ¦‚è¿°](#1-systemd-resolvedæœåŠ¡æ¦‚è¿°)
2. [æœåŠ¡æ¶æ„ä¸æ ¸å¿ƒåŠŸèƒ½](#2-æœåŠ¡æ¶æ„ä¸æ ¸å¿ƒåŠŸèƒ½)
3. [resolved.confé…ç½®è¯¦è§£](#3-resolvedconfé…ç½®è¯¦è§£)
4. [resolvectlå‘½ä»¤å®æˆ˜](#4-resolvectlå‘½ä»¤å®æˆ˜)
5. [DNS stubç›‘å¬å™¨](#5-dns-stubç›‘å¬å™¨)
6. [DNSSECå®‰å…¨éªŒè¯](#6-dnssecå®‰å…¨éªŒè¯)
7. [å¤šé“¾æ¥DNSé…ç½®](#7-å¤šé“¾æ¥dnsé…ç½®)
8. [DNSç¼“å­˜ç®¡ç†](#8-dnsç¼“å­˜ç®¡ç†)
9. [ä¼ ç»ŸDNSé…ç½®å…¼å®¹æ€§](#9-ä¼ ç»Ÿdnsé…ç½®å…¼å®¹æ€§)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ systemd-resolvedæœåŠ¡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯systemd-resolved


**ç®€å•ç†è§£**ï¼š`systemd-resolved`æ˜¯ç°ä»£Linuxç³»ç»Ÿä¸­çš„**DNSè§£æç®¡ç†æœåŠ¡**ï¼Œå°±åƒæ˜¯ä½ ç”µè„‘çš„"ç½‘å€ç¿»è¯‘å®˜"ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼šåº”ç”¨ç¨‹åº â†’ /etc/resolv.conf â†’ DNSæœåŠ¡å™¨
ç°ä»£æ–¹å¼ï¼šåº”ç”¨ç¨‹åº â†’ systemd-resolved â†’ æ™ºèƒ½è·¯ç”± â†’ æœ€ä¼˜DNSæœåŠ¡å™¨
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ” **ç»Ÿä¸€DNSç®¡ç†**ï¼šæ‰€æœ‰DNSæŸ¥è¯¢éƒ½é€šè¿‡å®ƒå¤„ç†
- âš¡ **æ™ºèƒ½ç¼“å­˜**ï¼šè®°ä½æŸ¥è¯¢è¿‡çš„åŸŸåï¼Œä¸‹æ¬¡æ›´å¿«
- ğŸ›¡ï¸ **å®‰å…¨éªŒè¯**ï¼šæ”¯æŒDNSSECé˜²æ­¢DNSåŠ«æŒ
- ğŸ”€ **çµæ´»è·¯ç”±**ï¼šä¸åŒç½‘ç»œæ¥å£ç”¨ä¸åŒDNSæœåŠ¡å™¨

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦systemd-resolved


**è§£å†³çš„é—®é¢˜**ï¼š

```
âŒ ä¼ ç»ŸDNSé…ç½®çš„ç—›ç‚¹ï¼š
â€¢ /etc/resolv.confæ–‡ä»¶å®¹æ˜“è¢«è¦†ç›–
â€¢ å¤šç½‘å¡ç¯å¢ƒDNSé…ç½®å¤æ‚
â€¢ æ²¡æœ‰ç»Ÿä¸€çš„DNSç¼“å­˜æœºåˆ¶
â€¢ ç¼ºä¹ç°ä»£å®‰å…¨ç‰¹æ€§

âœ… systemd-resolvedçš„ä¼˜åŠ¿ï¼š
â€¢ ç»Ÿä¸€çš„DNSé…ç½®ç®¡ç†
â€¢ æ™ºèƒ½çš„DNSæœåŠ¡å™¨é€‰æ‹©
â€¢ å†…ç½®ç¼“å­˜æå‡æ€§èƒ½
â€¢ æ”¯æŒç°ä»£å®‰å…¨æ ‡å‡†
```

### 1.3 å·¥ä½œåŸç†ç¤ºæ„


```
åº”ç”¨ç¨‹åº
    â†“
systemd-resolved (127.0.0.53:53)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ™ºèƒ½è·¯ç”±å†³ç­–             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ£€æŸ¥æœ¬åœ°ç¼“å­˜                  â”‚
â”‚ â€¢ é€‰æ‹©æœ€ä¼˜DNSæœåŠ¡å™¨             â”‚
â”‚ â€¢ åº”ç”¨DNSSECéªŒè¯               â”‚
â”‚ â€¢ å¤„ç†å¤šç½‘å¡DNSé…ç½®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å¤–éƒ¨DNSæœåŠ¡å™¨ (8.8.8.8, 1.1.1.1ç­‰)
```

---

## 2. âš™ï¸ æœåŠ¡æ¶æ„ä¸æ ¸å¿ƒåŠŸèƒ½


### 2.1 æœåŠ¡æ¶æ„ç»„ä»¶


**systemd-resolvedæ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨å±‚                     â”‚
â”‚  (æµè§ˆå™¨ã€curlã€pingç­‰ç½‘ç»œåº”ç”¨)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DNS Stub Resolver             â”‚
â”‚         (127.0.0.53:53)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         systemd-resolved                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        DNSç¼“å­˜                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚        DNSSECéªŒè¯               â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚        å¤šé“¾æ¥è·¯ç”±               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å¤–éƒ¨DNSæœåŠ¡å™¨                â”‚
â”‚    (8.8.8.8, 1.1.1.1, ISP DNSç­‰)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒåŠŸèƒ½è¯¦è§£


#### ğŸ” **DNSè§£ææœåŠ¡**

- **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰DNSæŸ¥è¯¢é€šè¿‡`127.0.0.53:53`å¤„ç†
- **åè®®æ”¯æŒ**ï¼šåŒæ—¶æ”¯æŒUDPå’ŒTCPæŸ¥è¯¢
- **IPv4/IPv6**ï¼šå®Œæ•´æ”¯æŒç°ä»£ç½‘ç»œåè®®

#### âš¡ **æ™ºèƒ½ç¼“å­˜æœºåˆ¶**

```
ç¼“å­˜å·¥ä½œæµç¨‹ï¼š
1. æ¥æ”¶DNSæŸ¥è¯¢è¯·æ±‚
2. æ£€æŸ¥æœ¬åœ°ç¼“å­˜ â†’ å‘½ä¸­åˆ™ç›´æ¥è¿”å›
3. ç¼“å­˜æœªå‘½ä¸­ â†’ è½¬å‘åˆ°ä¸Šæ¸¸DNS
4. ç¼“å­˜æŸ¥è¯¢ç»“æœ â†’ è®¾ç½®TTLè¿‡æœŸæ—¶é—´
5. è¿”å›ç»“æœç»™åº”ç”¨ç¨‹åº
```

#### ğŸ›¡ï¸ **å®‰å…¨åŠŸèƒ½**

- **DNSSECéªŒè¯**ï¼šé˜²æ­¢DNSæ¬ºéª—å’ŒåŠ«æŒ
- **DNS over TLS**ï¼šåŠ å¯†DNSæŸ¥è¯¢ä¼ è¾“
- **æ¶æ„åŸŸåè¿‡æ»¤**ï¼šå¯é…ç½®åŸŸåé»‘åå•

#### ğŸ”— **ç½‘ç»œæ„ŸçŸ¥**

- **æ¥å£ç»‘å®š**ï¼šä¸åŒç½‘å¡ä½¿ç”¨ä¸åŒDNSé…ç½®
- **åŠ¨æ€æ›´æ–°**ï¼šç½‘ç»œå˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°DNSé…ç½®
- **VPNæ”¯æŒ**ï¼šæ™ºèƒ½å¤„ç†VPNç¯å¢ƒçš„DNS

### 2.3 æœåŠ¡çŠ¶æ€ç®¡ç†


**æœåŠ¡æ§åˆ¶å‘½ä»¤**ï¼š

| æ“ä½œ | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| **æŸ¥çœ‹çŠ¶æ€** | `systemctl status systemd-resolved` | æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€ |
| **å¯åŠ¨æœåŠ¡** | `systemctl start systemd-resolved` | æ‰‹åŠ¨å¯åŠ¨æœåŠ¡ |
| **åœæ­¢æœåŠ¡** | `systemctl stop systemd-resolved` | åœæ­¢DNSè§£ææœåŠ¡ |
| **é‡å¯æœåŠ¡** | `systemctl restart systemd-resolved` | é‡æ–°åŠ è½½é…ç½® |
| **å¼€æœºå¯åŠ¨** | `systemctl enable systemd-resolved` | è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨ |

---

## 3. ğŸ“‹ resolved.confé…ç½®è¯¦è§£


### 3.1 é…ç½®æ–‡ä»¶ä½ç½®


**ä¸»é…ç½®æ–‡ä»¶**ï¼š`/etc/systemd/resolved.conf`

```
é…ç½®æ–‡ä»¶å±‚æ¬¡ç»“æ„ï¼š
/etc/systemd/resolved.conf          â† ä¸»é…ç½®æ–‡ä»¶
/etc/systemd/resolved.conf.d/       â† é¢å¤–é…ç½®ç›®å½•
/run/systemd/resolved.conf.d/       â† è¿è¡Œæ—¶é…ç½®
/usr/lib/systemd/resolved.conf.d/   â† è½¯ä»¶åŒ…é…ç½®
```

### 3.2 æ ¸å¿ƒé…ç½®é€‰é¡¹


#### ğŸŒ **DNSæœåŠ¡å™¨é…ç½®**


```ini
[Resolve]
# å…¨å±€DNSæœåŠ¡å™¨è®¾ç½®
DNS=8.8.8.8 1.1.1.1 2001:4860:4860::8888
# å¤‡ç”¨DNSæœåŠ¡å™¨
FallbackDNS=8.8.4.4 1.0.0.1
```

**é…ç½®è¯´æ˜**ï¼š
- **DNS**ï¼šä¸»è¦ä½¿ç”¨çš„DNSæœåŠ¡å™¨åˆ—è¡¨
- **FallbackDNS**ï¼šå½“ä¸»DNSä¸å¯ç”¨æ—¶çš„å¤‡ç”¨æœåŠ¡å™¨
- **æ ¼å¼**ï¼šæ”¯æŒIPv4ã€IPv6åœ°å€ï¼Œç©ºæ ¼åˆ†éš”

#### ğŸ” **æœç´¢åŸŸé…ç½®**


```ini
[Resolve]
# æœç´¢åŸŸè®¾ç½®
Domains=example.com local.lan
# LLMNR (Link-Local Multicast Name Resolution)
LLMNR=yes
# MulticastDNS (.localåŸŸåè§£æ)
MulticastDNS=yes
```

**å®é™…æ•ˆæœ**ï¼š
```
æŸ¥è¯¢ "server" â†’ è‡ªåŠ¨å°è¯•ï¼š
1. server.example.com
2. server.local.lan
3. server (åŸå§‹æŸ¥è¯¢)
```

#### ğŸ›¡ï¸ **å®‰å…¨é…ç½®é€‰é¡¹**


```ini
[Resolve]
# DNSSECéªŒè¯
DNSSEC=yes
# DNS over TLS
DNSOverTLS=yes
# ç¼“å­˜é…ç½®
Cache=yes
# DNS stubç›‘å¬å™¨
DNSStubListener=yes
```

**å®‰å…¨çº§åˆ«å¯¹ç…§**ï¼š

| é…ç½®å€¼ | **å®‰å…¨çº§åˆ«** | **è¯´æ˜** |
|--------|-------------|----------|
| `DNSSEC=yes` | **é«˜** | `å¼ºåˆ¶éªŒè¯ï¼Œå¤±è´¥åˆ™æ‹’ç»` |
| `DNSSEC=allow-downgrade` | **ä¸­** | `å°è¯•éªŒè¯ï¼Œå¤±è´¥åˆ™é™çº§` |
| `DNSSEC=no` | **ä½** | `ä¸è¿›è¡ŒDNSSECéªŒè¯` |

### 3.3 å®ç”¨é…ç½®ç¤ºä¾‹


#### ğŸ¢ **ä¼ä¸šç¯å¢ƒé…ç½®**


```ini
[Resolve]
# ä¼ä¸šå†…éƒ¨DNSæœåŠ¡å™¨
DNS=192.168.1.10 192.168.1.11
# å…¬ç½‘å¤‡ç”¨DNS
FallbackDNS=8.8.8.8 1.1.1.1
# ä¼ä¸šåŸŸå
Domains=company.local
# å¯ç”¨å®‰å…¨åŠŸèƒ½
DNSSEC=yes
Cache=yes
```

#### ğŸ  **å®¶åº­ç¯å¢ƒé…ç½®**


```ini
[Resolve]
# è¿è¥å•†DNS + å…¬å…±DNS
DNS=192.168.1.1 8.8.8.8
FallbackDNS=1.1.1.1 8.8.4.4
# æœ¬åœ°ç½‘ç»œæ”¯æŒ
LLMNR=yes
MulticastDNS=yes
# åŸºç¡€å®‰å…¨
DNSSEC=allow-downgrade
Cache=yes
```

---

## 4. ğŸ”§ resolvectlå‘½ä»¤å®æˆ˜


### 4.1 å‘½ä»¤æ¦‚è¿°


**resolvectl**ï¼šsystemd-resolvedçš„**å‘½ä»¤è¡Œç®¡ç†å·¥å…·**ï¼Œå°±åƒæ˜¯DNSé…ç½®çš„"é¥æ§å™¨"ã€‚

```
resolvectlçš„ä½œç”¨ï¼š
â€¢ æŸ¥çœ‹å½“å‰DNSé…ç½®çŠ¶æ€
â€¢ æ‰‹åŠ¨æ‰§è¡ŒDNSæŸ¥è¯¢æµ‹è¯•
â€¢ ç®¡ç†DNSç¼“å­˜
â€¢ é…ç½®æ¥å£ç‰¹å®šçš„DNSè®¾ç½®
```

### 4.2 çŠ¶æ€æŸ¥è¯¢å‘½ä»¤


#### ğŸ“Š **æŸ¥çœ‹æ•´ä½“çŠ¶æ€**


```bash
# æŸ¥çœ‹æ‰€æœ‰DNSé…ç½®ä¿¡æ¯
resolvectl status
```

**è¾“å‡ºç¤ºä¾‹è§£è¯»**ï¼š
```
Global
  LLMNR setting: yes                    â† LLMNRåŠŸèƒ½çŠ¶æ€
  MulticastDNS setting: yes            â† mDNSåŠŸèƒ½çŠ¶æ€
  DNSOverTLS setting: no               â† DNSåŠ å¯†çŠ¶æ€
  DNSSEC setting: yes                  â† DNSSECéªŒè¯çŠ¶æ€
  DNSSEC supported: yes                â† ç³»ç»ŸDNSSECæ”¯æŒ

Link 2 (enp0s3)
  Current Scopes: DNS LLMNR/IPv4 LLMNR/IPv6
  DefaultRoute setting: yes            â† é»˜è®¤è·¯ç”±çŠ¶æ€
  LLMNR setting: yes
  MulticastDNS setting: yes
  DNSOverTLS setting: no
  DNSSEC setting: yes
  DNSSEC supported: yes
  Current DNS Server: 8.8.8.8          â† å½“å‰ä½¿ç”¨çš„DNS
  DNS Servers: 8.8.8.8 1.1.1.1        â† é…ç½®çš„DNSåˆ—è¡¨
```

#### ğŸ” **æŸ¥çœ‹ç‰¹å®šæ¥å£**


```bash
# æŸ¥çœ‹ç‰¹å®šç½‘å¡çš„DNSé…ç½®
resolvectl status enp0s3

# ç®€åŒ–è¾“å‡ºï¼Œåªæ˜¾ç¤ºå…³é”®ä¿¡æ¯
resolvectl status --no-pager
```

### 4.3 DNSæŸ¥è¯¢æµ‹è¯•


#### ğŸŒ **åŸºç¡€åŸŸåè§£æ**


```bash
# åŸºæœ¬DNSæŸ¥è¯¢
resolvectl query www.google.com

# æŒ‡å®šè®°å½•ç±»å‹æŸ¥è¯¢
resolvectl query www.google.com A     # IPv4åœ°å€
resolvectl query www.google.com AAAA  # IPv6åœ°å€
resolvectl query www.google.com MX    # é‚®ä»¶æœåŠ¡å™¨
```

**æŸ¥è¯¢ç»“æœè§£è¯»**ï¼š
```
www.google.com: 142.250.191.4        â† è§£æç»“æœ
                -- link: enp0s3      â† ä½¿ç”¨çš„ç½‘å¡
                -- network: 8.8.8.8  â† ä½¿ç”¨çš„DNSæœåŠ¡å™¨
```

#### ğŸ”’ **DNSSECéªŒè¯æŸ¥è¯¢**


```bash
# å¸¦DNSSECéªŒè¯çš„æŸ¥è¯¢
resolvectl query --dnssec=yes www.cloudflare.com

# æ£€æŸ¥DNSSECçŠ¶æ€
resolvectl query --dnssec=yes fake-domain.example.com
```

### 4.4 é…ç½®ç®¡ç†å‘½ä»¤


#### âš™ï¸ **åŠ¨æ€DNSé…ç½®**


```bash
# ä¸ºç‰¹å®šæ¥å£è®¾ç½®DNSæœåŠ¡å™¨
resolvectl dns enp0s3 8.8.8.8 1.1.1.1

# è®¾ç½®æœç´¢åŸŸ
resolvectl domain enp0s3 example.com local.lan

# æŸ¥çœ‹å½“å‰é…ç½®
resolvectl status enp0s3
```

#### ğŸ—‘ï¸ **ç¼“å­˜ç®¡ç†**


```bash
# æ¸…ç©ºDNSç¼“å­˜
resolvectl flush-caches

# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
resolvectl statistics
```

**ç¼“å­˜ç»Ÿè®¡ç¤ºä¾‹**ï¼š
```
DNSSEC supported by current servers: yes
Transactions
Current Transactions: 0
Total Transactions: 1234
Cache
Current Cache Size: 156
Cache Hits: 890
Cache Misses: 344
```

---

## 5. ğŸ¯ DNS stubç›‘å¬å™¨


### 5.1 Stubç›‘å¬å™¨æ¦‚å¿µ


**DNS Stubç›‘å¬å™¨**ï¼šå¯ä»¥ç†è§£ä¸ºsystemd-resolvedåœ¨æœ¬åœ°å¼€è®¾çš„ä¸€ä¸ª"DNSæœåŠ¡çª—å£"ã€‚

```
å·¥ä½œåŸç†ï¼š
åº”ç”¨ç¨‹åº â†’ 127.0.0.53:53 â†’ systemd-resolved â†’ å¤–éƒ¨DNS
           â†‘
        DNS Stubç›‘å¬å™¨
        (æœ¬åœ°DNSæ¥æ”¶ç‚¹)
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸšª **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰DNSæŸ¥è¯¢çš„æœ¬åœ°æ¥å…¥ç‚¹
- ğŸ”„ **åè®®è½¬æ¢**ï¼šå¤„ç†ä¸åŒDNSæŸ¥è¯¢åè®®
- ğŸ“Š **æµé‡ç»Ÿè®¡**ï¼šè®°å½•DNSæŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯

### 5.2 ç›‘å¬å™¨é…ç½®


#### âš™ï¸ **å¯ç”¨/ç¦ç”¨é…ç½®**


```ini
[Resolve]
# å¯ç”¨DNS stubç›‘å¬å™¨ (é»˜è®¤)
DNSStubListener=yes

# ç¦ç”¨ç›‘å¬å™¨
DNSStubListener=no

# ä»…ç›‘å¬UDP
DNSStubListener=udp

# ä»…ç›‘å¬TCP
DNSStubListener=tcp
```

#### ğŸ”§ **é«˜çº§é…ç½®é€‰é¡¹**


```ini
[Resolve]
# è‡ªå®šä¹‰ç›‘å¬åœ°å€
DNSStubListenerExtra=192.168.1.10:5353
DNSStubListenerExtra=[::1]:5353

# ç¦ç”¨é»˜è®¤127.0.0.53ç›‘å¬
DNSStubListener=no
```

### 5.3 æ•…éšœæ’é™¤


#### ğŸš¨ **å¸¸è§é—®é¢˜è¯Šæ–­**


```bash
# æ£€æŸ¥stubç›‘å¬å™¨çŠ¶æ€
ss -tulnp | grep 127.0.0.53

# æµ‹è¯•æœ¬åœ°DNSå“åº”
dig @127.0.0.53 www.google.com

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :53
```

**é—®é¢˜è§£å†³æµç¨‹**ï¼š
```
ç«¯å£53è¢«å ç”¨ â†’
1. æ£€æŸ¥å…¶ä»–DNSæœåŠ¡ (bind9, dnsmasq)
2. åœæ­¢å†²çªæœåŠ¡
3. é‡å¯systemd-resolved
4. éªŒè¯127.0.0.53:53å¯ç”¨
```

---

## 6. ğŸ”’ DNSSECå®‰å…¨éªŒè¯


### 6.1 DNSSECåŸºæœ¬æ¦‚å¿µ


**DNSSEC**ï¼šDNSå®‰å…¨æ‰©å±•ï¼Œä¸ºDNSæŸ¥è¯¢ç»“æœæä¾›**æ•°å­—ç­¾åéªŒè¯**ã€‚

```
æ²¡æœ‰DNSSECçš„é£é™©ï¼š
ç”¨æˆ·æŸ¥è¯¢ google.com â†’
æ¶æ„DNSè¿”å› 192.168.1.100 (å‡IP) â†’
ç”¨æˆ·è¢«å¼•å¯¼åˆ°é’“é±¼ç½‘ç«™

æœ‰DNSSECä¿æŠ¤ï¼š
ç”¨æˆ·æŸ¥è¯¢ google.com â†’
DNSè¿”å›ç»“æœ + æ•°å­—ç­¾å â†’
systemd-resolvedéªŒè¯ç­¾å â†’
ç­¾åæ— æ•ˆåˆ™æ‹’ç»ç»“æœ
```

**å®‰å…¨ä»·å€¼**ï¼š
- ğŸ›¡ï¸ **é˜²DNSåŠ«æŒ**ï¼šç¡®ä¿DNSç»“æœæœªè¢«ç¯¡æ”¹
- âœ… **æ•°æ®å®Œæ•´æ€§**ï¼šéªŒè¯DNSè®°å½•çš„çœŸå®æ€§
- ğŸ” **èº«ä»½è®¤è¯**ï¼šç¡®è®¤DNSå“åº”æ¥æºå¯ä¿¡

### 6.2 DNSSECé…ç½®


#### âš™ï¸ **é…ç½®é€‰é¡¹è¯¦è§£**


```ini
[Resolve]
# DNSSECéªŒè¯çº§åˆ«
DNSSEC=yes                    # ä¸¥æ ¼éªŒè¯ï¼Œå¤±è´¥åˆ™æ‹’ç»
DNSSEC=allow-downgrade        # å°è¯•éªŒè¯ï¼Œå¤±è´¥æ—¶å…è®¸
DNSSEC=no                     # ç¦ç”¨DNSSECéªŒè¯
```

**éªŒè¯çº§åˆ«å¯¹æ¯”**ï¼š

| é…ç½® | **å®‰å…¨æ€§** | **å…¼å®¹æ€§** | **é€‚ç”¨åœºæ™¯** |
|------|-----------|-----------|-------------|
| `yes` | **ğŸ”´é«˜** | **ğŸŸ¡ä¸­** | `ä¼ä¸šå®‰å…¨ç¯å¢ƒ` |
| `allow-downgrade` | **ğŸŸ¡ä¸­** | **ğŸŸ¢é«˜** | `ä¸€èˆ¬ç”¨æˆ·æ¨è` |
| `no` | **ğŸ”´ä½** | **ğŸŸ¢é«˜** | `å…¼å®¹æ€§ä¼˜å…ˆ` |

#### ğŸ§ª **DNSSECæµ‹è¯•**


```bash
# æµ‹è¯•æ”¯æŒDNSSECçš„åŸŸå
resolvectl query --dnssec=yes www.cloudflare.com

# æµ‹è¯•DNSSECéªŒè¯å¤±è´¥æƒ…å†µ
resolvectl query --dnssec=yes dnssec-failed.org

# æŸ¥çœ‹DNSSECç»Ÿè®¡ä¿¡æ¯
resolvectl statistics
```

### 6.3 DNSSECæ•…éšœå¤„ç†


#### âš ï¸ **å¸¸è§éªŒè¯é—®é¢˜**


**é—®é¢˜1ï¼šDNSSECéªŒè¯å¤±è´¥**
```bash
# ç—‡çŠ¶ï¼šæ— æ³•è§£ææŸäº›åŸŸå
# è¯Šæ–­å‘½ä»¤
resolvectl query --dnssec=yes problem-domain.com
```

**è§£å†³æ–¹æ¡ˆæµç¨‹**ï¼š
```
DNSSECå¤±è´¥ â†’
1. æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®
2. å°è¯•ä¸åŒDNSæœåŠ¡å™¨
3. ä¸´æ—¶é™çº§éªŒè¯çº§åˆ«
4. è”ç³»åŸŸåç®¡ç†å‘˜ç¡®è®¤DNSSECé…ç½®
```

**é—®é¢˜2ï¼šæ€§èƒ½å½±å“**
- **ç°è±¡**ï¼šDNSæŸ¥è¯¢å˜æ…¢
- **åŸå› **ï¼šDNSSECéªŒè¯å¢åŠ é¢å¤–æ­¥éª¤
- **ä¼˜åŒ–**ï¼šå¯ç”¨ç¼“å­˜ï¼Œä½¿ç”¨æ”¯æŒDNSSECçš„å¿«é€ŸDNSæœåŠ¡å™¨

---

## 7. ğŸ”— å¤šé“¾æ¥DNSé…ç½®


### 7.1 å¤šé“¾æ¥åœºæ™¯


**å…¸å‹å¤šé“¾æ¥ç¯å¢ƒ**ï¼š

```
ç¬”è®°æœ¬ç”µè„‘åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¬”è®°æœ¬ç”µè„‘    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WiFi: wlan0     â”‚ â†’ å®¶åº­è·¯ç”±å™¨DNS
â”‚ ä»¥å¤ªç½‘: eth0    â”‚ â†’ å…¬å¸ç½‘ç»œDNS  
â”‚ VPN: tun0       â”‚ â†’ VPNæœåŠ¡å™¨DNS
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®æŒ‘æˆ˜**ï¼š
- ğŸ¢ **å…¬å¸å†…ç½‘**ï¼šéœ€è¦ä½¿ç”¨ä¼ä¸šDNSè§£æå†…éƒ¨åŸŸå
- ğŸ  **å®¶åº­ç½‘ç»œ**ï¼šä½¿ç”¨ISPæˆ–å…¬å…±DNS
- ğŸ”’ **VPNè¿æ¥**ï¼šVPNåŸŸåé€šè¿‡VPN DNSè§£æ
- ğŸ“± **ç§»åŠ¨ç½‘ç»œ**ï¼šè¿è¥å•†DNSé…ç½®

### 7.2 æ¥å£ç‰¹å®šDNSé…ç½®


#### âš™ï¸ **åŠ¨æ€é…ç½®æ–¹æ³•**


```bash
# ä¸ºWiFiæ¥å£é…ç½®ä¼ä¸šDNS
resolvectl dns wlan0 192.168.1.10 192.168.1.11

# è®¾ç½®ä¼ä¸šåŸŸåæœç´¢
resolvectl domain wlan0 company.local intranet.corp

# ä¸ºVPNæ¥å£é…ç½®ä¸“ç”¨DNS
resolvectl dns tun0 10.0.0.1

# è®¾ç½®VPNåŸŸåæœç´¢
resolvectl domain tun0 vpn.example.com
```

#### ğŸ“ **é™æ€é…ç½®æ–‡ä»¶**


åˆ›å»º`/etc/systemd/network/10-eth0.network`ï¼š
```ini
[Match]
Name=eth0

[Network]
DHCP=yes

[DHCP]
# ä½¿ç”¨DHCPè·å–çš„DNS
UseDNS=yes
# é¢å¤–çš„DNSæœåŠ¡å™¨
DNS=8.8.8.8
# æœç´¢åŸŸ
Domains=office.local
```

### 7.3 DNSè·¯ç”±è§„åˆ™


#### ğŸ¯ **åŸŸåè·¯ç”±ç­–ç•¥**


```
è·¯ç”±è§„åˆ™ç¤ºä¾‹ï¼š
*.company.local    â†’ å…¬å¸DNS (192.168.1.10)
*.vpn.example.com  â†’ VPN DNS (10.0.0.1)  
å…¶ä»–åŸŸå           â†’ å…¬å…±DNS (8.8.8.8)
```

**é…ç½®éªŒè¯**ï¼š
```bash
# æŸ¥çœ‹å½“å‰è·¯ç”±é…ç½®
resolvectl status

# æµ‹è¯•ç‰¹å®šåŸŸåè§£æè·¯å¾„
resolvectl query internal.company.local
resolvectl query www.google.com
```

#### âš¡ **ä¼˜å…ˆçº§ç®¡ç†**


**DNSæœåŠ¡å™¨é€‰æ‹©ä¼˜å…ˆçº§**ï¼š
1. **æ¥å£ç‰¹å®šDNS**ï¼šæœ€é«˜ä¼˜å…ˆçº§
2. **å…¨å±€DNSé…ç½®**ï¼šæ¬¡è¦é€‰æ‹©  
3. **å¤‡ç”¨DNSæœåŠ¡å™¨**ï¼šæœ€åé€‰æ‹©

```bash
# è®¾ç½®æ¥å£DNSä¼˜å…ˆçº§
resolvectl dns wlan0 192.168.1.10 --default-route=yes
resolvectl dns eth0 8.8.8.8 --default-route=no
```

---

## 8. ğŸ’¾ DNSç¼“å­˜ç®¡ç†


### 8.1 ç¼“å­˜æœºåˆ¶åŸç†


**DNSç¼“å­˜å·¥ä½œæµç¨‹**ï¼š

```
DNSæŸ¥è¯¢è¯·æ±‚ â†’
æ£€æŸ¥æœ¬åœ°ç¼“å­˜ â†’
â”Œâ”€ç¼“å­˜å‘½ä¸­â”€â”     â”Œâ”€ç¼“å­˜æœªå‘½ä¸­â”€â”
â”‚ç›´æ¥è¿”å›  â”‚     â”‚è½¬å‘æŸ¥è¯¢    â”‚
â”‚ç»“æœ     â”‚     â”‚åˆ°ä¸Šæ¸¸DNS   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
                â”‚ç¼“å­˜æ–°ç»“æœ  â”‚
                â”‚è¿”å›ç»™åº”ç”¨  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¼“å­˜ä¼˜åŠ¿**ï¼š
- âš¡ **æå‡é€Ÿåº¦**ï¼šé¿å…é‡å¤DNSæŸ¥è¯¢
- ğŸ“‰ **å‡å°‘æµé‡**ï¼šé™ä½ç½‘ç»œå¸¦å®½ä½¿ç”¨
- ğŸ”‹ **èŠ‚çœèµ„æº**ï¼šå‡å°‘ç³»ç»Ÿè´Ÿè½½
- ğŸ’ª **æé«˜ç¨³å®šæ€§**ï¼šDNSæœåŠ¡å™¨æ•…éšœæ—¶å¯ç”¨ç¼“å­˜

### 8.2 ç¼“å­˜é…ç½®é€‰é¡¹


#### âš™ï¸ **åŸºç¡€ç¼“å­˜è®¾ç½®**


```ini
[Resolve]
# å¯ç”¨DNSç¼“å­˜
Cache=yes

# ç¦ç”¨ç¼“å­˜ï¼ˆä¸æ¨èï¼‰
Cache=no

# ä»…ç¼“å­˜æˆåŠŸçš„æŸ¥è¯¢
Cache=no-negative
```

**ç¼“å­˜ç±»å‹è¯´æ˜**ï¼š
- **æ­£å‘ç¼“å­˜**ï¼šæˆåŠŸDNSæŸ¥è¯¢ç»“æœ
- **è´Ÿå‘ç¼“å­˜**ï¼šæŸ¥è¯¢å¤±è´¥ç»“æœï¼ˆé¿å…é‡å¤å¤±è´¥æŸ¥è¯¢ï¼‰
- **TTLç¼“å­˜**ï¼šæ ¹æ®DNSè®°å½•TTLå€¼å†³å®šç¼“å­˜æ—¶é—´

### 8.3 ç¼“å­˜ç®¡ç†å‘½ä»¤


#### ğŸ“Š **ç¼“å­˜çŠ¶æ€æŸ¥çœ‹**


```bash
# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
resolvectl statistics
```

**ç»Ÿè®¡ä¿¡æ¯è§£è¯»**ï¼š
```
Cache
Current Cache Size: 42              â† å½“å‰ç¼“å­˜æ¡ç›®æ•°
Cache Hits: 1337                   â† ç¼“å­˜å‘½ä¸­æ¬¡æ•°
Cache Misses: 159                  â† ç¼“å­˜æœªå‘½ä¸­æ¬¡æ•°

å‘½ä¸­ç‡è®¡ç®—: 1337/(1337+159) â‰ˆ 89%
```

#### ğŸ§¹ **ç¼“å­˜æ¸…ç†æ“ä½œ**


```bash
# æ¸…ç©ºæ‰€æœ‰DNSç¼“å­˜
resolvectl flush-caches

# é‡å¯æœåŠ¡æ¸…ç†ç¼“å­˜
systemctl restart systemd-resolved
```

**ä½•æ—¶éœ€è¦æ¸…ç†ç¼“å­˜**ï¼š
- ğŸ”§ **DNSé…ç½®å˜æ›´**ï¼šæ›´æ¢DNSæœåŠ¡å™¨å
- ğŸš¨ **è§£æå¼‚å¸¸**ï¼šåŸŸåè§£æå‡ºç°é”™è¯¯
- ğŸŒ **ç½‘ç»œåˆ‡æ¢**ï¼šåˆ‡æ¢ç½‘ç»œç¯å¢ƒå
- ğŸ› ï¸ **æ•…éšœæ’é™¤**ï¼šè¯Šæ–­DNSé—®é¢˜æ—¶

### 8.4 ç¼“å­˜ä¼˜åŒ–ç­–ç•¥


#### âš¡ **æ€§èƒ½ä¼˜åŒ–å»ºè®®**


**ç¼“å­˜é…ç½®æœ€ä½³å®è·µ**ï¼š
```ini
[Resolve]
# å¯ç”¨ç¼“å­˜
Cache=yes
# ä½¿ç”¨å¿«é€ŸDNSæœåŠ¡å™¨
DNS=1.1.1.1 8.8.8.8
# å¯ç”¨DNSSECï¼ˆæé«˜å®‰å…¨æ€§ï¼‰
DNSSEC=allow-downgrade
```

**ç›‘æ§ç¼“å­˜æ•ˆæœ**ï¼š
```bash
# å®šæœŸæ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
watch -n 5 'resolvectl statistics | grep -E "Cache|Hits|Misses"'

# æµ‹è¯•ç¼“å­˜æ•ˆæœ
time resolvectl query www.example.com  # ç¬¬ä¸€æ¬¡æŸ¥è¯¢
time resolvectl query www.example.com  # ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼ˆåº”è¯¥æ›´å¿«ï¼‰
```

---

## 9. ğŸ”„ ä¼ ç»ŸDNSé…ç½®å…¼å®¹æ€§


### 9.1 å…¼å®¹æ€§æ¦‚è¿°


**é…ç½®æ–‡ä»¶å…³ç³»**ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼š
/etc/resolv.conf (ç›´æ¥é…ç½®DNSæœåŠ¡å™¨)

ç°ä»£æ–¹å¼ï¼š
systemd-resolvedç®¡ç† â†’ è‡ªåŠ¨ç”Ÿæˆ /etc/resolv.conf
```

### 9.2 resolv.confæ–‡ä»¶å¤„ç†


#### ğŸ“ **æ–‡ä»¶é“¾æ¥æ¨¡å¼**


systemd-resolvedæä¾›å¤šç§`/etc/resolv.conf`å¤„ç†æ–¹å¼ï¼š

```bash
# æŸ¥çœ‹å½“å‰resolv.confç±»å‹
ls -la /etc/resolv.conf
```

**å››ç§é“¾æ¥æ¨¡å¼**ï¼š

| æ¨¡å¼ | **é“¾æ¥ç›®æ ‡** | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|-------------|----------|-------------|
| **stub** | `/run/systemd/resolve/stub-resolv.conf` | `æŒ‡å‘127.0.0.53` | **æ¨èï¼Œå®Œæ•´åŠŸèƒ½** |
| **static** | `/run/systemd/resolve/resolv.conf` | `ç›´æ¥æŒ‡å‘ä¸Šæ¸¸DNS` | **å…¼å®¹ä¼ ç»Ÿåº”ç”¨** |
| **uplink** | `/run/systemd/resolve/uplink-resolv.conf` | `ä»…ä¸Šæ¸¸DNS` | **ç‰¹æ®Šç½‘ç»œç¯å¢ƒ** |
| **æ‰‹åŠ¨** | `è‡ªå®šä¹‰æ–‡ä»¶` | `ç”¨æˆ·å®Œå…¨æ§åˆ¶` | **é«˜çº§ç”¨æˆ·** |

#### ğŸ”§ **åˆ‡æ¢é“¾æ¥æ¨¡å¼**


```bash
# åˆ‡æ¢åˆ°stubæ¨¡å¼ï¼ˆæ¨èï¼‰
ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf

# åˆ‡æ¢åˆ°staticæ¨¡å¼ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰
ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf

# éªŒè¯é…ç½®
cat /etc/resolv.conf
```

### 9.3 ä¼ ç»Ÿåº”ç”¨å…¼å®¹


#### ğŸ”§ **å…¼å®¹æ€§é—®é¢˜è§£å†³**


**é—®é¢˜1ï¼šåº”ç”¨ä¸æ”¯æŒ127.0.0.53**
```bash
# è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨staticæ¨¡å¼
ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf
```

**é—®é¢˜2ï¼šéœ€è¦è‡ªå®šä¹‰resolv.conf**
```bash
# åœç”¨systemd-resolvedç®¡ç†
systemctl disable systemd-resolved
# æ‰‹åŠ¨ç¼–è¾‘resolv.conf
echo "nameserver 8.8.8.8" > /etc/resolv.conf
```

#### âš™ï¸ **æ··åˆé…ç½®æ–¹æ¡ˆ**


ä¿æŒsystemd-resolvedè¿è¡Œï¼Œä½†å…è®¸ä¼ ç»Ÿé…ç½®ï¼š

```ini
# /etc/systemd/resolved.conf
[Resolve]
# ç¦ç”¨stubç›‘å¬å™¨
DNSStubListener=no
# ä¿æŒå…¶ä»–åŠŸèƒ½
Cache=yes
DNSSEC=yes
```

ç„¶åæ‰‹åŠ¨é…ç½®`/etc/resolv.conf`ï¼š
```
nameserver 127.0.0.54
nameserver 8.8.8.8
```

### 9.4 è¿ç§»ç­–ç•¥


#### ğŸ“‹ **ä»ä¼ ç»ŸDNSè¿ç§»**


**è¿ç§»æ£€æŸ¥æ¸…å•**ï¼š

```
è¿ç§»å‰å‡†å¤‡ï¼š
â˜ å¤‡ä»½å½“å‰ /etc/resolv.conf
â˜ è®°å½•ç°æœ‰DNSæœåŠ¡å™¨é…ç½®
â˜ è¯†åˆ«ä¾èµ–ä¼ ç»Ÿé…ç½®çš„åº”ç”¨
â˜ åˆ¶å®šå›æ»šè®¡åˆ’

è¿ç§»æ­¥éª¤ï¼š
1. å¯ç”¨ systemd-resolved
2. é…ç½® resolved.conf
3. è®¾ç½®é€‚å½“çš„é“¾æ¥æ¨¡å¼
4. æµ‹è¯•DNSè§£æåŠŸèƒ½
5. éªŒè¯åº”ç”¨ç¨‹åºå…¼å®¹æ€§
```

**è¿ç§»éªŒè¯å‘½ä»¤**ï¼š
```bash
# å¤‡ä»½åŸé…ç½®
cp /etc/resolv.conf /etc/resolv.conf.backup

# å¯ç”¨systemd-resolved
systemctl enable --now systemd-resolved

# è®¾ç½®stubæ¨¡å¼
ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf

# æµ‹è¯•DNSè§£æ
resolvectl query www.google.com
dig www.google.com

# å¦‚éœ€å›æ»š
# systemctl disable --now systemd-resolved
# mv /etc/resolv.conf.backup /etc/resolv.conf
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ systemd-resolvedæœ¬è´¨ï¼šç°ä»£Linuxçš„ç»Ÿä¸€DNSç®¡ç†æœåŠ¡
ğŸ”¸ å·¥ä½œåŸç†ï¼šåº”ç”¨â†’127.0.0.53â†’æ™ºèƒ½è·¯ç”±â†’å¤–éƒ¨DNS
ğŸ”¸ æ ¸å¿ƒåŠŸèƒ½ï¼šDNSè§£æã€ç¼“å­˜ã€DNSSECéªŒè¯ã€å¤šé“¾æ¥æ”¯æŒ
ğŸ”¸ é…ç½®æ–‡ä»¶ï¼š/etc/systemd/resolved.confæ§åˆ¶å…¨å±€è®¾ç½®
ğŸ”¸ ç®¡ç†å·¥å…·ï¼šresolvectlå‘½ä»¤è¿›è¡ŒçŠ¶æ€æŸ¥è¯¢å’Œé…ç½®ç®¡ç†
ğŸ”¸ å…¼å®¹æ€§ï¼šé€šè¿‡ä¸åŒé“¾æ¥æ¨¡å¼å…¼å®¹ä¼ ç»ŸDNSé…ç½®
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆé€‰æ‹©systemd-resolved**
```
ç°ä»£éœ€æ±‚ï¼š
â€¢ å¤šç½‘å¡ç¯å¢ƒéœ€è¦æ™ºèƒ½DNSè·¯ç”±
â€¢ ç§»åŠ¨åŠå…¬éœ€è¦åŠ¨æ€DNSé…ç½®  
â€¢ å®‰å…¨å¨èƒéœ€è¦DNSSECä¿æŠ¤
â€¢ æ€§èƒ½è¦æ±‚éœ€è¦æ™ºèƒ½ç¼“å­˜

ä¼ ç»Ÿå±€é™ï¼š
â€¢ /etc/resolv.confé…ç½®å•ä¸€
â€¢ ç¼ºä¹ç¼“å­˜å’Œå®‰å…¨ç‰¹æ€§
â€¢ å¤šç½‘ç»œç¯å¢ƒé…ç½®å¤æ‚
```

**ğŸ”¹ DNS Stubç›‘å¬å™¨çš„ä½œç”¨**
```
ç»Ÿä¸€å…¥å£ï¼š127.0.0.53:53æ¥æ”¶æ‰€æœ‰DNSæŸ¥è¯¢
æ™ºèƒ½å¤„ç†ï¼šæ ¹æ®é…ç½®é€‰æ‹©æœ€ä¼˜DNSæœåŠ¡å™¨
é€æ˜ç¼“å­˜ï¼šåº”ç”¨ç¨‹åºæ— éœ€å…³å¿ƒç¼“å­˜å®ç°
å®‰å…¨éªŒè¯ï¼šåœ¨åº”ç”¨ç¨‹åºæ— æ„ŸçŸ¥æƒ…å†µä¸‹æä¾›DNSSEC
```

**ğŸ”¹ å¤šé“¾æ¥DNSçš„ä»·å€¼**
```
åœºæ™¯é€‚é…ï¼šä¸åŒç½‘ç»œä½¿ç”¨ä¸åŒDNSé…ç½®
åŸŸåè·¯ç”±ï¼šä¼ä¸šåŸŸåèµ°ä¼ä¸šDNSï¼Œå…¬ç½‘åŸŸåèµ°å…¬å…±DNS
åŠ¨æ€è°ƒæ•´ï¼šç½‘ç»œå˜åŒ–æ—¶è‡ªåŠ¨åˆ‡æ¢DNSé…ç½®
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é…ç½®å»ºè®®**

```
å®¶åº­ç”¨æˆ·é…ç½®ï¼š
[Resolve]
DNS=8.8.8.8 1.1.1.1
FallbackDNS=8.8.4.4 1.0.0.1
DNSSEC=allow-downgrade
Cache=yes
LLMNR=yes
MulticastDNS=yes

ä¼ä¸šç”¨æˆ·é…ç½®ï¼š
[Resolve]
DNS=192.168.1.10 192.168.1.11
FallbackDNS=8.8.8.8 1.1.1.1
Domains=company.local
DNSSEC=yes
Cache=yes
DNSOverTLS=yes
```

**ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤**
```bash
# æ—¥å¸¸çŠ¶æ€æ£€æŸ¥
resolvectl status

# DNSæŸ¥è¯¢æµ‹è¯•
resolvectl query www.example.com

# ç¼“å­˜ç®¡ç†
resolvectl flush-caches
resolvectl statistics

# é…ç½®æ›´æ”¹åé‡å¯
systemctl restart systemd-resolved
```

**ğŸš¨ æ•…éšœæ’é™¤æµç¨‹**
```
DNSè§£æå¼‚å¸¸ â†’
1. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼šsystemctl status systemd-resolved
2. æŸ¥çœ‹é…ç½®ï¼šresolvectl status
3. æµ‹è¯•æŸ¥è¯¢ï¼šresolvectl query test-domain.com
4. æ£€æŸ¥ç¼“å­˜ï¼šresolvectl statistics
5. æ¸…ç†ç¼“å­˜ï¼šresolvectl flush-caches
6. é‡å¯æœåŠ¡ï¼šsystemctl restart systemd-resolved
```

### 10.4 å­¦ä¹ é‡ç‚¹å›é¡¾


**ğŸ’¡ æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- systemd-resolvedæ˜¯ç°ä»£Linux DNSç®¡ç†çš„**æ ‡å‡†æ–¹æ¡ˆ**
- é€šè¿‡**127.0.0.53:53**æä¾›ç»Ÿä¸€çš„DNSæœåŠ¡å…¥å£
- æ”¯æŒ**æ™ºèƒ½ç¼“å­˜ã€DNSSECéªŒè¯ã€å¤šé“¾æ¥è·¯ç”±**
- ä½¿ç”¨**resolvectlå‘½ä»¤**è¿›è¡Œç®¡ç†å’Œæ•…éšœæ’é™¤
- é€šè¿‡**ä¸åŒé“¾æ¥æ¨¡å¼**å®ç°ä¸ä¼ ç»Ÿé…ç½®çš„å…¼å®¹

**ğŸ¯ å®è·µå»ºè®®**ï¼š
- ç†è§£systemd-resolvedçš„å·¥ä½œåŸç†å’Œä¼˜åŠ¿
- ç†Ÿç»ƒä½¿ç”¨resolvectlå‘½ä»¤è¿›è¡Œæ—¥å¸¸ç®¡ç†
- æ ¹æ®ç½‘ç»œç¯å¢ƒé€‰æ‹©åˆé€‚çš„é…ç½®æ–¹æ¡ˆ
- æŒæ¡å¸¸è§é—®é¢˜çš„è¯Šæ–­å’Œè§£å†³æ–¹æ³•
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…è¿›è¡Œé…ç½®å˜æ›´