---
title: 2、Podman安装与配置
---
## 📚 目录

1. [Podman概述与优势](#1-podman概述与优势)
2. [系统要求与依赖检查](#2-系统要求与依赖检查)
3. [不同发行版安装方法](#3-不同发行版安装方法)
4. [核心配置文件详解](#4-核心配置文件详解)
5. [用户命名空间配置](#5-用户命名空间配置)
6. [安装验证与故障排除](#6-安装验证与故障排除)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🐋 Podman概述与优势


### 1.1 什么是Podman


**Podman简介**：Podman是一个**无守护进程的容器引擎**，用于在Linux系统上开发、管理和运行容器。

```
传统Docker架构：
用户命令 → Docker客户端 → Docker守护进程 → 容器运行

Podman架构：
用户命令 → Podman → 直接创建容器进程
```

> 💡 **通俗理解**  
> 把Podman想象成一个"直接的容器管理员"，而Docker像是"通过中介管理的系统"。Podman去掉了中间的守护进程，让容器管理更直接、更安全。

### 1.2 Podman的核心优势


**🔸 安全性优势**
- **无根容器支持**：普通用户就能运行容器，不需要root权限
- **无守护进程**：减少了攻击面，提高系统安全性
- **用户命名空间**：容器内的root实际上是宿主机的普通用户

**🔸 兼容性优势**
- **Docker命令兼容**：大部分Docker命令可以直接用`podman`替换
- **镜像格式兼容**：可以直接使用Docker Hub的镜像
- **Kubernetes集成**：原生支持Pod概念，更好地与K8s集成

**🔸 管理优势**
- **系统集成**：与systemd深度集成，可以作为系统服务管理
- **资源隔离**：每个用户的容器相互隔离
- **无单点故障**：没有中央守护进程，更稳定

### 1.3 Podman vs Docker对比


| 特性对比 | **Podman** | **Docker** | **说明** |
|---------|-----------|-----------|----------|
| 🏗️ **架构** | `无守护进程` | `C/S架构+守护进程` | `Podman更简洁安全` |
| 🔐 **权限需求** | `支持无根运行` | `需要root或docker组` | `Podman安全性更高` |
| 🎯 **命令兼容** | `高度兼容Docker命令` | `原生命令` | `迁移成本低` |
| 🔧 **系统集成** | `systemd原生支持` | `需要额外配置` | `Podman更适合Linux` |
| 📦 **Pod支持** | `原生支持` | `不直接支持` | `Podman更适合K8s` |

---

## 2. 🔧 系统要求与依赖检查


### 2.1 基本系统要求


**最低系统要求**：
- **操作系统**：Linux内核版本 >= 4.18.0
- **内存**：至少2GB RAM（推荐4GB以上）
- **存储**：至少10GB可用磁盘空间
- **架构**：x86_64、aarch64、ppc64le、s390x

**推荐配置**：
```
CPU：4核心以上
内存：8GB以上
存储：50GB以上SSD
网络：稳定的互联网连接（下载镜像）
```

### 2.2 依赖包检查


**检查当前系统信息**：
```bash
# 查看系统版本
cat /etc/os-release

# 查看内核版本
uname -r

# 查看架构信息
uname -m
```

**关键依赖组件**：
- **runc**：容器运行时
- **conmon**：容器监控工具
- **CNI插件**：网络配置
- **fuse-overlayfs**：存储驱动（无根模式需要）
- **slirp4netns**：网络命名空间工具

### 2.3 系统兼容性检查


**检查cgroup版本**（影响资源限制功能）：
```bash
# 查看cgroup版本
stat -fc %T /sys/fs/cgroup/

# 输出解释：
# tmpfs = cgroup v1
# cgroup2fs = cgroup v2
```

> ⚠️ **注意事项**  
> cgroup v2提供更好的性能和功能，但某些旧版本系统可能只支持v1。Podman对两种版本都支持，但功能会有差异。

---

## 3. 📦 不同发行版安装方法


### 3.1 Red Hat系列（RHEL/CentOS/Fedora）


**Fedora安装**（推荐方式）：
```bash
# 更新包管理器
sudo dnf update -y

# 安装Podman完整套件
sudo dnf install -y podman podman-compose podman-docker

# 验证安装
podman --version
```

**CentOS 8/RHEL 8安装**：
```bash
# 启用PowerTools仓库（提供额外依赖）
sudo dnf config-manager --enable powertools

# 安装Podman
sudo dnf install -y podman

# 安装额外工具
sudo dnf install -y buildah skopeo
```

**CentOS 7安装**（需要额外仓库）：
```bash
# 添加官方仓库
sudo curl -L -o /etc/yum.repos.d/devel:kubic:libcontainers:stable.repo \
    https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/CentOS_7/devel:kubic:libcontainers:stable.repo

# 安装Podman
sudo yum install -y podman
```

### 3.2 Debian系列（Ubuntu/Debian）


**Ubuntu 20.04及以上**：
```bash
# 更新包索引
sudo apt update

# 安装Podman
sudo apt install -y podman

# 安装相关工具
sudo apt install -y buildah skopeo
```

**较老版本Ubuntu**（需要第三方仓库）：
```bash
# 添加官方仓库源
. /etc/os-release
echo "deb https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_${VERSION_ID}/ /" | sudo tee /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list

# 添加GPG密钥
curl -L https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable/xUbuntu_${VERSION_ID}/Release.key | sudo apt-key add -

# 更新并安装
sudo apt update
sudo apt install -y podman
```

### 3.3 其他发行版


**Arch Linux**：
```bash
# 使用pacman安装
sudo pacman -S podman

# 安装相关工具
sudo pacman -S buildah skopeo
```

**openSUSE**：
```bash
# 使用zypper安装
sudo zypper install podman

# 安装额外组件
sudo zypper install buildah skopeo
```

### 3.4 源码编译安装


**适用场景**：需要最新版本或自定义编译选项

```bash
# 安装编译依赖
sudo dnf install -y git golang make

# 克隆源码
git clone https://github.com/containers/podman.git
cd podman

# 编译安装
make BUILDTAGS="selinux seccomp"
sudo make install
```

---

## 4. ⚙️ 核心配置文件详解


### 4.1 配置文件架构


**Podman配置文件层次**：
```
/etc/containers/           ← 系统级配置（所有用户）
├── registries.conf        ← 镜像仓库配置
├── storage.conf           ← 存储配置
├── containers.conf        ← 容器运行配置
└── policy.json           ← 镜像签名策略

~/.config/containers/      ← 用户级配置（当前用户）
├── registries.conf
├── storage.conf
└── containers.conf
```

> 💡 **配置优先级**  
> 用户级配置 > 系统级配置。这意味着用户可以覆盖系统默认设置，实现个性化配置。

### 4.2 registries.conf - 镜像仓库配置


**主要作用**：定义从哪些镜像仓库拉取镜像，以及仓库的优先级和镜像源配置。

```toml
# /etc/containers/registries.conf

# 无前缀镜像的搜索仓库列表
[registries.search]
registries = ['docker.io', 'quay.io', 'registry.fedoraproject.org']

# 不安全的仓库（HTTP协议）
[registries.insecure]
registries = ['localhost:5000']

# 被阻止的仓库
[registries.block]
registries = ['some-malicious-registry.com']

# 镜像源配置（加速下载）
[[registry]]
prefix = "docker.io"
location = "docker.io"

[[registry.mirror]]
location = "registry.cn-hangzhou.aliyuncs.com"
```

**配置说明**：
- **search registries**：当你运行`podman search nginx`时，会在这些仓库中搜索
- **insecure registries**：允许使用HTTP协议的私有仓库
- **mirror配置**：配置国内镜像源，加速镜像下载

### 4.3 storage.conf - 存储配置


**主要作用**：配置容器和镜像的存储方式、位置和存储驱动。

```toml
# /etc/containers/storage.conf

[storage]
# 存储驱动类型
driver = "overlay"

# 镜像和容器数据存储根目录
graphroot = "/var/lib/containers/storage"

# 临时运行时数据目录
runroot = "/run/containers/storage"

[storage.options]
# overlay驱动专用选项
additionalimagestores = []

[storage.options.overlay]
# 挂载程序路径
mount_program = "/usr/bin/fuse-overlayfs"
```

**用户级存储配置示例**：
```toml
# ~/.config/containers/storage.conf

[storage]
driver = "overlay"
graphroot = "/home/username/.local/share/containers/storage"
runroot = "/run/user/1000/containers"

[storage.options.overlay]
mount_program = "/usr/bin/fuse-overlayfs"
```

**存储驱动对比**：

| 驱动类型 | **适用场景** | **性能** | **功能特性** |
|---------|-------------|---------|-------------|
| **overlay** | `生产环境推荐` | `高性能` | `支持写时复制，节省空间` |
| **vfs** | `测试环境` | `低性能` | `简单可靠，占用空间大` |
| **devicemapper** | `旧版系统` | `中等性能` | `功能完整，配置复杂` |

### 4.4 containers.conf - 容器配置


**主要作用**：定义容器运行时的默认行为和资源限制。

```toml
# /etc/containers/containers.conf

[containers]
# 默认容器网络
default_network = "podman"

# DNS服务器配置
dns_servers = ["8.8.8.8", "8.8.4.4"]

# 默认容器用户
default_user = "root"

# 默认工作目录
default_workdir = "/"

[engine]
# 容器运行时
runtime = "runc"

# 网络后端
network_backend = "netavark"

# 事件日志大小
events_logger = "file"

[network]
# 默认子网
default_subnet = "10.88.0.0/16"

# 默认子网掩码长度
default_subnet_pools = [
    {"base" = "10.89.0.0/16", "size" = 24},
]
```

### 4.5 policy.json - 镜像签名策略


**主要作用**：定义镜像拉取时的安全验证策略，确保镜像来源可信。

```json
{
    "default": [
        {
            "type": "insecureAcceptAnything"
        }
    ],
    "transports": {
        "docker": {
            "registry.access.redhat.com": [
                {
                    "type": "signedBy",
                    "keyType": "GPGKeys",
                    "keyPath": "/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release"
                }
            ],
            "registry.redhat.io": [
                {
                    "type": "signedBy",
                    "keyType": "GPGKeys", 
                    "keyPath": "/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release"
                }
            ]
        }
    }
}
```

**安全策略类型**：
- **insecureAcceptAnything**：接受任何镜像（不推荐生产环境）
- **signedBy**：要求镜像有有效的GPG签名
- **reject**：拒绝从指定仓库拉取镜像

---

## 5. 👥 用户命名空间配置


### 5.1 无根容器的核心概念


**什么是无根容器**：
无根容器让普通用户能够运行容器，容器内的root用户实际映射为宿主机的普通用户，大大提高了安全性。

```
传统方式（需要root）：
宿主机root → 容器root （同一用户，权限过大）

无根方式：
宿主机user1000 → 容器root （映射关系，权限隔离）
```

> 💡 **安全优势**  
> 即使容器被攻破，攻击者获得的也只是宿主机普通用户权限，而不是root权限。

### 5.2 用户命名空间配置文件


**subuid配置**（用户ID映射）：
```bash
# 查看当前用户的subuid配置
cat /etc/subuid

# 典型输出：
# username:100000:65536
# 格式：用户名:起始UID:数量
```

**subgid配置**（组ID映射）：
```bash
# 查看当前用户的subgid配置
cat /etc/subgid

# 典型输出：
# username:100000:65536
# 格式：用户名:起始GID:数量
```

### 5.3 配置用户命名空间


**自动配置用户ID映射**：
```bash
# 为当前用户添加subuid和subgid
sudo usermod --add-subuids 100000-165535 --add-subgids 100000-165535 $USER

# 验证配置
grep $USER /etc/subuid /etc/subgid
```

**手动编辑配置文件**：
```bash
# 编辑subuid文件
sudo vim /etc/subuid
# 添加行：username:100000:65536

# 编辑subgid文件
sudo vim /etc/subgid  
# 添加行：username:100000:65536
```

### 5.4 无根模式启用验证


**检查无根模式是否可用**：
```bash
# 检查用户命名空间支持
podman unshare cat /proc/self/uid_map

# 正常输出示例：
#          0       1000          1
#          1     100000      65536
```

**运行无根容器测试**：
```bash
# 不使用sudo运行容器
podman run --rm -it alpine whoami

# 在容器外检查进程所有者
ps aux | grep podman
```

### 5.5 解决常见权限问题


**文件系统权限问题**：
```bash
# 创建用户级存储目录
mkdir -p ~/.local/share/containers
mkdir -p ~/.config/containers

# 设置正确权限
chmod 755 ~/.local/share/containers
chmod 755 ~/.config/containers
```

**网络权限问题**：
```bash
# 安装无根网络工具
sudo dnf install slirp4netns

# 验证网络功能
podman run --rm -it alpine ping -c 3 google.com
```

---

## 6. ✅ 安装验证与故障排除


### 6.1 基本功能验证


**验证Podman安装**：
```bash
# 检查版本信息
podman --version
podman version

# 查看系统信息
podman info
```

**运行第一个容器**：
```bash
# 拉取测试镜像
podman pull hello-world

# 运行测试容器
podman run hello-world

# 预期输出：Hello from Docker! 等欢迎信息
```

### 6.2 功能完整性测试


**测试镜像操作**：
```bash
# 搜索镜像
podman search nginx

# 拉取镜像
podman pull docker.io/library/nginx:latest

# 查看本地镜像
podman images
```

**测试容器操作**：
```bash
# 运行后台容器
podman run -d --name test-nginx -p 8080:80 nginx

# 检查容器状态
podman ps

# 测试容器网络
curl http://localhost:8080

# 清理测试容器
podman stop test-nginx
podman rm test-nginx
```

### 6.3 常见问题排除


**问题1：权限不足错误**
```
错误信息：ERRO[0000] cannot find UID/GID for user
解决方案：
1. 检查subuid/subgid配置
2. 重新登录用户会话
3. 确认用户在正确的组中
```

**问题2：网络连接问题**
```
错误信息：network is unreachable
解决方案：
1. 安装slirp4netns: sudo dnf install slirp4netns
2. 检查防火墙设置
3. 验证DNS配置
```

**问题3：存储空间问题**
```
错误信息：no space left on device
解决方案：
1. 清理无用镜像：podman image prune
2. 清理无用容器：podman container prune
3. 修改存储位置到更大分区
```

### 6.4 性能优化检查


**检查存储驱动性能**：
```bash
# 查看当前存储驱动
podman info | grep -A5 "Store:"

# 测试镜像拉取速度
time podman pull alpine:latest
```

**检查网络性能**：
```bash
# 测试容器网络延迟
podman run --rm -it alpine ping -c 5 8.8.8.8

# 测试容器间通信
podman network create test-net
podman run -d --name server --network test-net nginx
podman run --rm --network test-net alpine wget -O- http://server
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 Podman本质：无守护进程的安全容器引擎
🔸 核心优势：无根运行、Docker兼容、系统集成
🔸 安装要求：Linux内核4.18+、相关依赖包
🔸 配置层次：系统配置 + 用户配置，用户配置优先
🔸 关键配置：registries.conf、storage.conf、containers.conf
🔸 安全特性：用户命名空间、镜像签名验证
```

### 7.2 配置文件速记


**📁 四大核心配置文件**：

| 配置文件 | **主要作用** | **关键配置项** |
|---------|-------------|--------------|
| **registries.conf** | `镜像仓库管理` | `搜索仓库、镜像源、安全策略` |
| **storage.conf** | `存储配置` | `存储驱动、数据目录、挂载选项` |
| **containers.conf** | `容器运行配置` | `网络设置、资源限制、运行时` |
| **policy.json** | `安全策略` | `镜像签名验证、信任策略` |

### 7.3 关键理解要点


**🔹 为什么选择Podman**
- **安全性**：无守护进程架构，减少攻击面
- **兼容性**：Docker命令兼容，迁移成本低  
- **集成性**：与Linux系统深度集成
- **灵活性**：支持无根运行，权限控制精细

**🔹 安装成功的标志**
- `podman --version` 显示版本信息
- `podman run hello-world` 成功运行
- `podman info` 显示完整系统信息
- 无根模式下能正常创建容器

**🔹 配置优化要点**
- 配置国内镜像源加速下载
- 启用无根模式提高安全性
- 根据需求调整存储驱动
- 设置合理的资源限制

### 7.4 实践应用指导


**🎯 新手入门路径**：
1. **安装验证**：确保基本功能正常
2. **配置优化**：设置镜像源和存储
3. **无根启用**：配置用户命名空间
4. **功能测试**：运行实际应用容器

**🔧 生产环境考虑**：
- 选择稳定版本，避免使用开发版
- 配置严格的镜像签名策略
- 设置合理的存储和网络配置
- 建立监控和日志收集机制

**核心记忆口诀**：
- Podman容器引擎新，无守护进程更安全
- 四大配置要记清，仓库存储容器策略
- 无根模式权限控，用户命名空间配置
- 安装配置验证好，生产使用没烦恼