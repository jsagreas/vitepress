---
title: 9、卷组查看与监控
---
## 📚 目录

1. [卷组查看基础概念](#1-卷组查看基础概念)
2. [vgdisplay命令详解](#2-vgdisplay命令详解)
3. [vgs命令格式化输出](#3-vgs命令格式化输出)
4. [vgscan扫描与激活](#4-vgscan扫描与激活)
5. [卷组状态与健康检查](#5-卷组状态与健康检查)
6. [空间使用统计分析](#6-空间使用统计分析)
7. [物理卷分布情况](#7-物理卷分布情况)
8. [卷组活动状态管理](#8-卷组活动状态管理)
9. [性能监控指标](#9-性能监控指标)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🔍 卷组查看基础概念


### 1.1 什么是卷组监控


**卷组监控**就是**实时了解你的存储池状态**，就像查看银行账户余额一样。

```
简单理解：
💰 银行账户 = 卷组(VG)
💵 账户余额 = 可用空间
💳 银行卡   = 物理卷(PV)
📊 对账单   = 监控命令

监控目的：知道还有多少空间可用，哪些地方有问题
```

### 1.2 为什么要监控卷组


**核心原因**：
- 🔸 **空间预警**：避免磁盘空间不足导致系统崩溃
- 🔸 **性能优化**：发现存储瓶颈，及时调整
- 🔸 **故障预防**：提前发现硬件问题
- 🔸 **容量规划**：为扩容做准备

### 1.3 监控命令总览


| 命令 | **作用** | **使用场景** | **信息详细程度** |
|------|---------|-------------|-----------------|
| `vgdisplay` | **详细信息查看** | 全面了解卷组状态 | 🔴**最详细** |
| `vgs` | **简洁表格显示** | 快速查看多个卷组 | 🟡**中等** |
| `vgscan` | **扫描激活卷组** | 系统启动或故障恢复 | 🟢**基础** |

---

## 2. 📊 vgdisplay命令详解


### 2.1 基本使用方法


`vgdisplay`是**查看卷组详细信息的主力命令**，就像查看房产证一样详细。

```bash
# 查看所有卷组的详细信息
vgdisplay

# 查看指定卷组
vgdisplay myvg
```

### 2.2 输出信息解读


```
实际输出示例：
--- Volume group ---
VG Name               myvg          ← 卷组名称
System ID                           
Format                lvm2          ← LVM版本格式
Metadata Areas        2             ← 元数据区域数量
Metadata Sequence No  3             ← 元数据序列号
VG Access             read/write    ← 访问权限
VG Status             resizable     ← 是否可调整大小
MAX LV                0             ← 最大逻辑卷数量(0=无限制)
Cur LV                2             ← 当前逻辑卷数量
Open LV               1             ← 正在使用的逻辑卷数量
Max PV                0             ← 最大物理卷数量(0=无限制)
Cur PV                2             ← 当前物理卷数量
Act PV                2             ← 活动物理卷数量
VG Size               19.99 GiB     ← 卷组总大小
PE Size               4.00 MiB      ← PE(物理扩展)大小
Total PE              5118          ← 总PE数量
Alloc PE / Size       2560 / 10.00 GiB  ← 已分配PE数量/大小
Free  PE / Size       2558 / 9.99 GiB   ← 空闲PE数量/大小
VG UUID               abc123-def456-...  ← 卷组唯一标识
```

### 2.3 关键信息含义解释


**🔸 PE(Physical Extent) - 物理扩展**
```
通俗理解：PE就像乐高积木的基本单元
- 每个PE默认4MB大小
- 分配逻辑卷时按PE为单位
- Total PE = VG Size ÷ PE Size
```

**🔸 卷组状态标识**
```
VG Status含义：
✅ resizable  : 可以扩容缩容
❌ NOT resizable : 不可调整(通常因为在使用中)
⚠️  partial   : 部分物理卷不可用
🔒 read-only  : 只读模式
```

### 2.4 常用选项参数


```bash
# 显示更详细的信息
vgdisplay -v myvg

# 只显示卷组名称(适合脚本使用)
vgdisplay -s

# 以MB为单位显示大小
vgdisplay --units m myvg
```

---

## 3. 📋 vgs命令格式化输出


### 3.1 为什么要用vgs


`vgs`命令就像**Excel表格**一样，把多个卷组的关键信息排列整齐，**一眼看出重点**。

```
vgdisplay vs vgs 对比：
vgdisplay → 📄 像看详细说明书
vgs       → 📊 像看汇总报表
```

### 3.2 基本使用


```bash
# 查看所有卷组概要信息
vgs

# 查看指定卷组
vgs myvg anothervg
```

**典型输出**：
```
  VG       #PV #LV #SN Attr   VSize   VFree 
  myvg       2   2   0 wz--n- 19.99g  9.99g
  centos     1   2   0 wz--n- 19.51g     0
```

### 3.3 输出字段含义


| 字段 | **含义** | **示例** | **说明** |
|------|---------|---------|---------|
| `VG` | **卷组名称** | myvg | 卷组的标识名 |
| `#PV` | **物理卷数量** | 2 | 包含几个硬盘/分区 |
| `#LV` | **逻辑卷数量** | 2 | 创建了几个逻辑卷 |
| `#SN` | **快照数量** | 0 | 当前快照个数 |
| `Attr` | **属性标志** | wz--n- | 卷组状态标识 |
| `VSize` | **总大小** | 19.99g | 卷组总容量 |
| `VFree` | **剩余空间** | 9.99g | 还能分配的空间 |

### 3.4 属性标志详解


**Attr字段解读**（以`wz--n-`为例）：
```
位置1(w): 权限标志
  w = 可写(writable)
  r = 只读(read-only)

位置2(z): 调整标志  
  z = 可调整大小(resizable)
  - = 不可调整

位置3(-): 分配策略
  l = 连续分配
  n = 正常分配  
  - = 未设置

位置4(-): 集群标志
  c = 集群卷组
  - = 本地卷组

位置5(n): 状态标志
  a = 活动(active)
  s = 暂停(suspended)  
  n = 正常

位置6(-): 扩展标志
  - = 普通卷组
```

### 3.5 自定义显示格式


```bash
# 自定义显示字段
vgs -o vg_name,vg_size,vg_free,pv_count

# 显示百分比信息
vgs -o vg_name,vg_size,vg_free,vg_free_percent

# 按剩余空间排序
vgs --sort vg_free
```

---

## 4. 🔍 vgscan扫描与激活


### 4.1 vgscan的作用机制


`vgscan`就像**系统重新认识硬盘**的过程，类似电脑重启后重新识别设备。

```
扫描过程图解：

系统启动 → 检测硬盘 → 读取LVM标签 → 激活卷组
    ↓         ↓          ↓           ↓
   硬件      物理卷      元数据       可用状态
```

### 4.2 基本使用场景


```bash
# 基本扫描(最常用)
vgscan

# 详细扫描信息
vgscan -v

# 强制重新构建缓存
vgscan --cache
```

**典型输出**：
```
Reading volume groups from cache.
Found volume group "myvg" using metadata type lvm2
Found volume group "centos" using metadata type lvm2
```

### 4.3 何时需要使用vgscan


**🔸 必需场景**：
- ✅ **系统启动时**：自动执行，无需手动
- ✅ **新增硬盘后**：让系统识别新的物理卷
- ✅ **故障恢复时**：重建损坏的缓存信息
- ✅ **卷组导入后**：从其他系统迁移卷组

**🔸 错误案例**：
```bash
# 错误：卷组找不到
$ vgdisplay newvg
Volume group "newvg" not found

# 解决：重新扫描
$ vgscan
$ vgdisplay newvg  # 现在可以找到了
```

### 4.4 扫描与激活的区别


```
扫描(scan) vs 激活(activate)：

扫描：只是"发现"卷组，像点名册
激活：让卷组"可用"，像开门营业

vgscan     → 发现卷组
vgchange -a y → 激活卷组(如果需要)
```

---

## 5. 🏥 卷组状态与健康检查


### 5.1 健康状态分类


**卷组健康状态**就像体检报告，分为几个等级：

```
🟢 健康(Normal)    : 所有组件正常工作
🟡 警告(Warning)   : 有小问题但能正常使用  
🔴 严重(Critical)  : 有严重问题需要立即处理
⚫ 故障(Failed)    : 无法正常工作
```

### 5.2 状态检查命令组合


```bash
# 全面健康检查
vgdisplay -v          # 详细状态信息
pvs -o pv_name,vg_name,pv_attr,pv_health  # 物理卷健康状态
lvs -o lv_name,vg_name,lv_attr,lv_health  # 逻辑卷健康状态
```

### 5.3 常见状态问题识别


**🔸 物理卷故障标识**
```bash
# 检查物理卷状态
pvs -o pv_name,pv_attr

输出示例：
PV         Attr
/dev/sdb1  a--     ← 正常
/dev/sdc1  a-m     ← 有问题(missing)
/dev/sdd1  ---     ← 不可用
```

**属性标识含义**：
- `a` = 可分配(allocatable)
- `-` = 不可分配  
- `m` = 缺失(missing)
- `x` = 导出状态(exported)

### 5.4 卷组修复操作


```bash
# 当发现物理卷缺失时的处理步骤

# 1. 查看详细问题
vgdisplay -v myvg

# 2. 尝试激活(如果只是未激活)
vgchange -a y myvg

# 3. 修复缺失的物理卷
vgreduce --removemissing myvg

# 4. 验证修复结果
vgdisplay myvg
```

---

## 6. 📊 空间使用统计分析


### 6.1 空间使用核心指标


**理解存储空间**就像管理仓库，要知道：
- 📦 **总容量**：仓库一共多大
- 📋 **已使用**：放了多少货物  
- 🆓 **剩余量**：还能放多少
- 📈 **使用率**：占用百分比

### 6.2 详细空间查看


```bash
# 查看空间使用详情
vgs -o vg_name,vg_size,vg_free,vg_free_percent --units g

# 示例输出
VG     VSize   VFree  Free%
myvg   20.00g  10.00g 50.00
centos 19.51g   0.00g  0.00
```

### 6.3 空间使用分析表格


| 卷组名 | **总大小** | **已用** | **剩余** | **使用率** | **状态评估** |
|--------|-----------|---------|---------|-----------|-------------|
| myvg | 20GB | 10GB | 10GB | 50% | 🟢**正常** |
| centos | 19.51GB | 19.51GB | 0GB | 100% | 🔴**满载** |
| datavg | 100GB | 85GB | 15GB | 85% | 🟡**紧张** |

### 6.4 空间预警阈值


**空间使用率建议**：
```
🟢 0-70%   : 安全范围，正常使用
🟡 70-90%  : 需要关注，准备扩容  
🔴 90-95%  : 紧急状态，立即处理
⚫ 95-100% : 危险状态，系统可能崩溃
```

### 6.5 空间不足处理方案


```bash
# 当空间不足时的处理顺序

# 方案1: 清理不需要的逻辑卷
lvremove /dev/myvg/oldlv

# 方案2: 缩小现有逻辑卷
lvreduce -L -5G /dev/myvg/datalv

# 方案3: 添加新的物理卷扩容
pvcreate /dev/sde1
vgextend myvg /dev/sde1

# 方案4: 创建新卷组分担压力
vgcreate newvg /dev/sdf1
```

---

## 7. 💾 物理卷分布情况


### 7.1 什么是物理卷分布


**物理卷分布**就是了解**数据存放在哪些硬盘上**，就像知道文件放在哪个柜子里。

```
卷组内物理卷分布图：

myvg 卷组
├── /dev/sdb1 (10GB) ████████░░ 80%已用
├── /dev/sdc1 (10GB) ██████░░░░ 60%已用  
└── /dev/sdd1 (5GB)  ██░░░░░░░░ 20%已用

目的：了解负载均衡情况，避免某块硬盘过载
```

### 7.2 查看物理卷分布


```bash
# 查看卷组内的物理卷分布
pvs -o pv_name,vg_name,pv_size,pv_free,pv_used

# 查看特定卷组的物理卷
pvdisplay -S vgname=myvg

# 查看物理卷的PE使用情况
pvs -o pv_name,pv_pe_count,pv_pe_alloc_count,pv_free_count
```

### 7.3 分布均衡性分析


**理想分布状态**：
```
均衡分布示例：
PV         Size   Used   Free   Usage%
/dev/sdb1  10.00g 5.00g  5.00g  50%
/dev/sdc1  10.00g 5.00g  5.00g  50%  
/dev/sdd1  10.00g 5.00g  5.00g  50%

不均衡分布示例：
PV         Size   Used   Free   Usage%
/dev/sdb1  10.00g 9.50g  0.50g  95%  ← 过载
/dev/sdc1  10.00g 2.00g  8.00g  20%  ← 闲置
/dev/sdd1  10.00g 3.00g  7.00g  30%  ← 闲置
```

### 7.4 分布优化策略


```bash
# 使用pvmove重新分布数据
# 将过载的物理卷数据迁移到空闲物理卷

# 1. 查看当前分布
pvs -o pv_name,pv_used,pv_free

# 2. 将数据从sdb1迁移到sdc1
pvmove /dev/sdb1 /dev/sdc1

# 3. 验证迁移结果  
pvs -o pv_name,pv_used,pv_free
```

---

## 8. 🔄 卷组活动状态管理


### 8.1 活动状态概念


**卷组活动状态**就像电器的**开关状态**：
- 🟢 **Active(激活)**：正在工作，可以读写数据
- 🔴 **Inactive(非激活)**：处于关闭状态，无法使用

### 8.2 查看活动状态


```bash
# 查看所有卷组活动状态
vgs -o vg_name,vg_attr

# 输出示例
VG     Attr  
myvg   wz--n-  ← 正常激活状态
datavg wz--na  ← 活动状态
```

**Attr字段第5位含义**：
- `a` = active(激活)
- `s` = suspended(暂停)
- `-` = inactive(未激活)

### 8.3 激活与停用操作


```bash
# 激活卷组(让卷组可以使用)
vgchange -a y myvg

# 停用卷组(安全移除前必须)
vgchange -a n myvg

# 激活指定的逻辑卷
vgchange -a y myvg/datalv
```

### 8.4 活动状态管理场景


**🔸 日常维护场景**：
```
系统启动时：
vgchange -a y        # 激活所有卷组

系统关机前：  
vgchange -a n        # 停用所有卷组(可选)

硬件维护时：
vgchange -a n myvg   # 停用要维护的卷组
# 进行硬件操作
vgchange -a y myvg   # 维护完成后重新激活
```

---

## 9. 📈 性能监控指标


### 9.1 关键性能指标


**LVM性能监控**就像汽车仪表盘，要关注几个重要指标：

```
核心指标组合：
🏃 IOPS    : 每秒读写次数(像车速)
⏱️ 延迟     : 响应时间(像刹车距离)  
📊 吞吐量   : 数据传输速度(像油耗)
💾 空间利用: 存储使用率(像油箱剩余)
```

### 9.2 实时监控命令


```bash
# 使用iostat监控LVM设备
iostat -x 1 5  # 每1秒显示一次，共5次

# 监控特定设备
iostat -x /dev/mapper/myvg-datalv 1

# 使用iotop查看进程IO使用情况  
iotop -o  # 只显示有IO活动的进程
```

### 9.3 性能指标解读


**iostat输出重要字段**：
```
Device  r/s    w/s   rkB/s   wkB/s  %util
dm-0   50.2   20.1   2048     804    85.2

字段含义：
r/s    : 每秒读操作数
w/s    : 每秒写操作数  
rkB/s  : 每秒读取KB数
wkB/s  : 每秒写入KB数
%util  : 设备使用率百分比
```

### 9.4 性能问题识别


**性能瓶颈判断标准**：
```
🟢 正常状态：
   %util < 70%
   延迟 < 10ms
   
🟡 需要关注：
   %util 70-90%
   延迟 10-50ms
   
🔴 性能瓶颈：
   %util > 90%
   延迟 > 50ms
```

### 9.5 性能优化建议


**常见优化策略**：
```bash
# 1. 调整条带化参数提升并发性能
lvcreate -L 10G -i 2 -I 64K -n stripelv myvg

# 2. 使用性能更好的磁盘
# 将频繁访问的LV迁移到SSD

# 3. 调整文件系统参数
# 针对不同工作负载优化挂载选项

# 4. 启用读缓存
# 合理配置系统缓存参数
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心概念


```
🔸 vgdisplay：查看卷组详细信息的主要命令
🔸 vgs：快速查看多个卷组状态的表格工具  
🔸 vgscan：系统扫描识别卷组的基础命令
🔸 空间监控：防止存储空间不足导致系统问题
🔸 健康检查：及时发现并处理硬件故障
🔸 性能监控：确保存储系统高效运行
```

### 10.2 关键理解要点


**🔹 监控命令选择原则**
```
日常快速检查 → 使用vgs命令
详细故障诊断 → 使用vgdisplay -v  
系统启动问题 → 使用vgscan重新扫描
性能分析需求 → 结合iostat等工具
```

**🔹 空间管理最佳实践**
```
预防性监控：
- 设置空间使用率告警(推荐80%)
- 定期检查卷组健康状态
- 提前规划扩容方案

应急处理：
- 优先清理临时数据
- 考虑缩减不重要的逻辑卷
- 必要时添加新物理卷扩容
```

**🔹 性能优化思路**
```
识别瓶颈：
- 使用iostat监控设备利用率
- 关注%util和延迟指标
- 分析读写模式

优化策略：
- 数据分布均衡化
- 选择合适的条带参数  
- 硬件升级(如使用SSD)
```

### 10.3 实际应用价值


**🎯 运维实践场景**
- **日常巡检**：每日使用vgs检查存储状态
- **故障排查**：vgdisplay定位具体问题
- **容量规划**：基于使用趋势制定扩容计划
- **性能调优**：结合监控数据优化存储配置

**🔧 自动化监控脚本示例**
```bash
#!/bin/bash
# LVM卷组监控脚本

# 检查空间使用率超过80%的卷组
vgs --noheadings -o vg_name,vg_free_percent | \
while read vg free_percent; do
    if [ ${free_percent%.*} -lt 20 ]; then
        echo "警告: 卷组 $vg 剩余空间不足20%"
    fi
done

# 检查非活动状态的卷组
vgs --noheadings -o vg_name,vg_attr | \
while read vg attr; do
    if [[ $attr != *"a"* ]]; then
        echo "警告: 卷组 $vg 未激活"
    fi
done
```

### 10.4 学习进阶路径


**基础掌握** `→` **深入理解** `→` **实践应用** `→` **自动化运维`

```
第一阶段：熟练使用基本监控命令
第二阶段：理解各种状态指标含义  
第三阶段：能够诊断和解决常见问题
第四阶段：建立完整的监控体系
```

**核心记忆口诀**：
- vgdisplay详细看，vgs简洁快速览
- vgscan识别新设备，空间不足早预防  
- 健康检查防故障，性能监控保高效
- 八成空间要告警，均衡分布性能佳