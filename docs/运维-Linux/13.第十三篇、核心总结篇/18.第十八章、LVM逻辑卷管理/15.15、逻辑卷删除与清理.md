---
title: 15ã€é€»è¾‘å·åˆ é™¤ä¸Žæ¸…ç†
---
## ðŸ“š ç›®å½•

1. [é€»è¾‘å·åˆ é™¤åŸºç¡€æ¦‚å¿µ](#1-é€»è¾‘å·åˆ é™¤åŸºç¡€æ¦‚å¿µ)
2. [åˆ é™¤å‰çš„å‡†å¤‡å·¥ä½œ](#2-åˆ é™¤å‰çš„å‡†å¤‡å·¥ä½œ)
3. [lvremoveå‘½ä»¤è¯¦è§£](#3-lvremoveå‘½ä»¤è¯¦è§£)
4. [å®‰å…¨åˆ é™¤æµç¨‹](#4-å®‰å…¨åˆ é™¤æµç¨‹)
5. [æ‰¹é‡åˆ é™¤æ“ä½œ](#5-æ‰¹é‡åˆ é™¤æ“ä½œ)
6. [åˆ é™¤åŽç©ºé—´ç®¡ç†](#6-åˆ é™¤åŽç©ºé—´ç®¡ç†)
7. [æ„å¤–åˆ é™¤æ¢å¤æ–¹æ³•](#7-æ„å¤–åˆ é™¤æ¢å¤æ–¹æ³•)
8. [æ¸…ç†éªŒè¯ä¸Žæœ€ä½³å®žè·µ](#8-æ¸…ç†éªŒè¯ä¸Žæœ€ä½³å®žè·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ—‘ï¸ é€»è¾‘å·åˆ é™¤åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é€»è¾‘å·åˆ é™¤


**é€»è¾‘å·åˆ é™¤**å°±æ˜¯æŠŠä¸å†éœ€è¦çš„LVMé€»è¾‘å·ä»Žç³»ç»Ÿä¸­å½»åº•ç§»é™¤çš„æ“ä½œã€‚

```
ç®€å•ç†è§£ï¼š
å°±åƒåˆ é™¤ç”µè„‘ä¸Šçš„æ–‡ä»¶å¤¹ä¸€æ ·ï¼Œé€»è¾‘å·åˆ é™¤å°±æ˜¯æŠŠè¿™ä¸ª"è™šæ‹Ÿç¡¬ç›˜"
ä»Žç³»ç»Ÿä¸­æ‹¿æŽ‰ï¼Œé‡Šæ”¾å®ƒå ç”¨çš„ç£ç›˜ç©ºé—´ç»™å…¶ä»–ç”¨é€”ä½¿ç”¨ã€‚

åˆ é™¤è¿‡ç¨‹ï¼š
é€»è¾‘å·(LV) â†’ å¸è½½æ–‡ä»¶ç³»ç»Ÿ â†’ åˆ é™¤é€»è¾‘å· â†’ ç©ºé—´å›žåˆ°å·ç»„(VG)
```

### 1.2 åˆ é™¤æ“ä½œçš„å½±å“èŒƒå›´


**ðŸ”¸ è¢«åˆ é™¤çš„å†…å®¹**
- **é€»è¾‘å·æœ¬èº«**ï¼šæ•´ä¸ªLVå­˜å‚¨å•å…ƒæ¶ˆå¤±
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šå·ä¸Šçš„ext4ã€xfsç­‰æ–‡ä»¶ç³»ç»Ÿè¢«é”€æ¯  
- **æ‰€æœ‰æ•°æ®**ï¼šå­˜å‚¨åœ¨è¯¥å·ä¸Šçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•
- **æŒ‚è½½ç‚¹**ï¼šç³»ç»Ÿä¸­çš„æŒ‚è½½å…³ç³»æ–­å¼€

**ðŸ”¸ ä¸å—å½±å“çš„å†…å®¹**
- **å·ç»„**ï¼šVGä»ç„¶å­˜åœ¨ï¼Œåªæ˜¯å¯ç”¨ç©ºé—´å¢žåŠ 
- **ç‰©ç†å·**ï¼šPVå®Œå…¨ä¸å—å½±å“
- **å…¶ä»–é€»è¾‘å·**ï¼šåŒä¸€VGä¸‹çš„å…¶ä»–LVæ­£å¸¸è¿è¡Œ

### 1.3 åˆ é™¤æ“ä½œçš„ç±»åž‹åˆ†ç±»


```
æŒ‰åˆ é™¤æ–¹å¼åˆ†ç±»ï¼š

ðŸ”¸ æ‰‹åŠ¨åˆ é™¤
â€¢ ç®¡ç†å‘˜ä¸»åŠ¨æ‰§è¡Œåˆ é™¤å‘½ä»¤
â€¢ å¯ä»¥é€‰æ‹©æ˜¯å¦å¤‡ä»½æ•°æ®
â€¢ æœ‰å……åˆ†çš„å‡†å¤‡æ—¶é—´

ðŸ”¸ å¼ºåˆ¶åˆ é™¤  
â€¢ ä½¿ç”¨-få‚æ•°å¼ºåˆ¶åˆ é™¤
â€¢ è·³è¿‡æŸäº›å®‰å…¨æ£€æŸ¥
â€¢ ç”¨äºŽç´§æ€¥æƒ…å†µæˆ–è‡ªåŠ¨åŒ–è„šæœ¬

ðŸ”¸ æ‰¹é‡åˆ é™¤
â€¢ ä¸€æ¬¡åˆ é™¤å¤šä¸ªé€»è¾‘å·
â€¢ é€šè¿‡è„šæœ¬æˆ–é€šé…ç¬¦å®žçŽ°
â€¢ æé«˜è¿ç»´æ•ˆçŽ‡
```

---

## 2. ðŸ›¡ï¸ åˆ é™¤å‰çš„å‡†å¤‡å·¥ä½œ


### 2.1 æ•°æ®å¤‡ä»½ç­–ç•¥


**ä¸ºä»€ä¹ˆå¿…é¡»å¤‡ä»½**ï¼šé€»è¾‘å·åˆ é™¤æ˜¯**ä¸å¯é€†æ“ä½œ**ï¼Œæ•°æ®ä¸€æ—¦åˆ é™¤å°±æ— æ³•ç®€å•æ¢å¤ã€‚

**ðŸ”¸ å¤‡ä»½æ–¹æ³•é€‰æ‹©**

| å¤‡ä»½æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|------------|----------|----------|
| `cpæ‹·è´` | `å°æ–‡ä»¶ï¼Œç®€å•ç›®å½•` | `æ“ä½œç®€å•ï¼Œç›´è§‚æ˜“æ‡‚` | `é€Ÿåº¦æ…¢ï¼Œå ç”¨ç³»ç»Ÿèµ„æº` |
| `tarå½’æ¡£` | `éœ€è¦åŽ‹ç¼©ï¼Œè¿œç¨‹å¤‡ä»½` | `åŽ‹ç¼©çŽ‡é«˜ï¼Œä¾¿äºŽä¼ è¾“` | `éœ€è¦é¢å¤–è§£åŽ‹æ­¥éª¤` |
| `rsyncåŒæ­¥` | `å¤§æ–‡ä»¶ï¼Œå¢žé‡å¤‡ä»½` | `æ”¯æŒå¢žé‡ï¼Œä¼ è¾“æ•ˆçŽ‡é«˜` | `é…ç½®ç›¸å¯¹å¤æ‚` |
| `ddå…‹éš†` | `æ•´ä¸ªåˆ†åŒºï¼ŒåŽŸæ ·å¤‡ä»½` | `å®Œæ•´å…‹éš†ï¼ŒåŒ…å«æ–‡ä»¶ç³»ç»Ÿ` | `å¤‡ä»½æ–‡ä»¶å¾ˆå¤§` |

**ðŸ’¡ å®žé™…å¤‡ä»½ç¤ºä¾‹**
```bash
# æ–¹æ³•1ï¼šç®€å•æ–‡ä»¶æ‹·è´
cp -r /mnt/lv_data/* /backup/lv_data_backup/

# æ–¹æ³•2ï¼štaråŽ‹ç¼©å¤‡ä»½
tar -czf /backup/lv_data_$(date +%Y%m%d).tar.gz -C /mnt/lv_data .

# æ–¹æ³•3ï¼šrsyncå¢žé‡å¤‡ä»½  
rsync -av --progress /mnt/lv_data/ /backup/lv_data_backup/
```

### 2.2 ç¡®è®¤é€»è¾‘å·ä¿¡æ¯


**åˆ é™¤å‰å¿…é¡»ç¡®è®¤çš„ä¿¡æ¯**ï¼š

```bash
# æŸ¥çœ‹è¦åˆ é™¤çš„é€»è¾‘å·è¯¦ç»†ä¿¡æ¯
lvdisplay /dev/vg_data/lv_web

# æŸ¥çœ‹é€»è¾‘å·çš„æŒ‚è½½çŠ¶æ€
df -h | grep lv_web
mount | grep lv_web

# æŸ¥çœ‹é€»è¾‘å·ä½¿ç”¨æƒ…å†µ
lsof +D /mnt/lv_web
```

**ðŸ”¸ å…³é”®ç¡®è®¤é¡¹**
- **æŒ‚è½½çŠ¶æ€**ï¼šç¡®ä¿æ²¡æœ‰ç¨‹åºæ­£åœ¨ä½¿ç”¨
- **æ•°æ®é‡è¦æ€§**ï¼šè¯„ä¼°æ•°æ®çš„ä»·å€¼å’Œå¯æ¢å¤æ€§
- **ä¾èµ–å…³ç³»**ï¼šæ£€æŸ¥æ˜¯å¦æœ‰åº”ç”¨ä¾èµ–è¯¥å·
- **ç©ºé—´å¤§å°**ï¼šäº†è§£åˆ é™¤åŽèƒ½é‡Šæ”¾å¤šå°‘ç©ºé—´

### 2.3 ç³»ç»ŸæœåŠ¡åœæ­¢


**éœ€è¦åœæ­¢çš„ç›¸å…³æœåŠ¡**ï¼š
```bash
# åœæ­¢å¯èƒ½ä½¿ç”¨è¯¥é€»è¾‘å·çš„æœåŠ¡
systemctl stop nginx        # å¦‚æžœç½‘ç«™æ–‡ä»¶åœ¨è¯¥å·ä¸Š
systemctl stop mysqld       # å¦‚æžœæ•°æ®åº“åœ¨è¯¥å·ä¸Š
systemctl stop application  # å…¶ä»–ç›¸å…³åº”ç”¨æœåŠ¡

# ç¡®è®¤æ²¡æœ‰è¿›ç¨‹åœ¨ä½¿ç”¨
fuser -m /mnt/lv_data
lsof +D /mnt/lv_data
```

---

## 3. âš¡ lvremoveå‘½ä»¤è¯¦è§£


### 3.1 åŸºæœ¬è¯­æ³•æ ¼å¼


```bash
lvremove [é€‰é¡¹] é€»è¾‘å·è·¯å¾„
```

**ðŸ”¸ é€»è¾‘å·è·¯å¾„çš„è¡¨ç¤ºæ–¹æ³•**
```bash
# æ–¹æ³•1ï¼šå®Œæ•´è·¯å¾„
lvremove /dev/vg_data/lv_web

# æ–¹æ³•2ï¼šå·ç»„å/é€»è¾‘å·å
lvremove vg_data/lv_web

# æ–¹æ³•3ï¼šä»…é€»è¾‘å·å(å½“å‰å·ç»„)
lvremove lv_web
```

### 3.2 å¸¸ç”¨é€‰é¡¹å‚æ•°


**ðŸ”¸ æ ¸å¿ƒå‚æ•°è¯´æ˜Ž**

| å‚æ•° | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** |
|------|----------|-------------|
| `-f` | `å¼ºåˆ¶åˆ é™¤ï¼Œè·³è¿‡ç¡®è®¤` | `è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæ‰¹é‡æ“ä½œ` |
| `-y` | `å¯¹æ‰€æœ‰è¯¢é—®å›žç­”yes` | `é¿å…äº¤äº’ï¼Œè‡ªåŠ¨ç¡®è®¤` |
| `-v` | `æ˜¾ç¤ºè¯¦ç»†åˆ é™¤è¿‡ç¨‹` | `è°ƒè¯•é—®é¢˜ï¼ŒæŸ¥çœ‹æ‰§è¡Œæ­¥éª¤` |
| `-t` | `æµ‹è¯•æ¨¡å¼ï¼Œä¸å®žé™…åˆ é™¤` | `éªŒè¯å‘½ä»¤æ­£ç¡®æ€§` |

**ðŸ’¡ å‚æ•°ç»„åˆä½¿ç”¨**
```bash
# å®‰å…¨æµ‹è¯•ï¼šå…ˆçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ
lvremove -t /dev/vg_data/lv_test

# å¼ºåˆ¶åˆ é™¤ï¼šè·³è¿‡æ‰€æœ‰ç¡®è®¤
lvremove -f -y /dev/vg_data/lv_old

# è¯¦ç»†æ¨¡å¼ï¼šæŸ¥çœ‹åˆ é™¤è¿‡ç¨‹
lvremove -v /dev/vg_data/lv_debug
```

### 3.3 åˆ é™¤è¿‡ç¨‹ä¸­çš„äº¤äº’æç¤º


**ðŸ”¸ å…¸åž‹çš„åˆ é™¤äº¤äº’è¿‡ç¨‹**
```bash
$ lvremove /dev/vg_data/lv_web
Do you really want to remove active logical volume vg_data/lv_web? [y/n]: y
  Logical volume "lv_web" successfully removed
```

**ç³»ç»Ÿä¼šè¯¢é—®çš„é—®é¢˜**ï¼š
- **æ˜¯å¦çœŸçš„è¦åˆ é™¤**ï¼šé˜²æ­¢è¯¯æ“ä½œ
- **é€»è¾‘å·æ­£åœ¨ä½¿ç”¨**ï¼šå¦‚æžœå·è¿˜åœ¨æŒ‚è½½çŠ¶æ€
- **ç¡®è®¤åˆ é™¤æ´»è·ƒå·**ï¼šå¯¹äºŽæ­£åœ¨ä½¿ç”¨çš„æ´»è·ƒå·

---

## 4. ðŸ›¡ï¸ å®‰å…¨åˆ é™¤æµç¨‹


### 4.1 æ ‡å‡†åˆ é™¤æ­¥éª¤


**ðŸ”¸ å®Œæ•´çš„å®‰å…¨åˆ é™¤æµç¨‹**

```
ç¬¬1æ­¥ï¼šæ•°æ®å¤‡ä»½
â”œâ”€â”€ è¯„ä¼°æ•°æ®é‡è¦æ€§
â”œâ”€â”€ é€‰æ‹©åˆé€‚çš„å¤‡ä»½æ–¹æ³•  
â””â”€â”€ éªŒè¯å¤‡ä»½å®Œæ•´æ€§

ç¬¬2æ­¥ï¼šåœæ­¢ç›¸å…³æœåŠ¡
â”œâ”€â”€ è¯†åˆ«ä½¿ç”¨è¯¥å·çš„æœåŠ¡
â”œâ”€â”€ å®‰å…¨åœæ­¢ç›¸å…³è¿›ç¨‹
â””â”€â”€ ç¡®è®¤æ²¡æœ‰æ®‹ç•™è¿›ç¨‹

ç¬¬3æ­¥ï¼šå¸è½½æ–‡ä»¶ç³»ç»Ÿ
â”œâ”€â”€ umountå¸è½½æŒ‚è½½ç‚¹
â”œâ”€â”€ ä»Ž/etc/fstabåˆ é™¤æ¡ç›®
â””â”€â”€ éªŒè¯å¸è½½æˆåŠŸ

ç¬¬4æ­¥ï¼šåˆ é™¤é€»è¾‘å·
â”œâ”€â”€ æ‰§è¡Œlvremoveå‘½ä»¤
â”œâ”€â”€ ç¡®è®¤åˆ é™¤æˆåŠŸ
â””â”€â”€ éªŒè¯å·ç»„ç©ºé—´å›žæ”¶

ç¬¬5æ­¥ï¼šæ¸…ç†éªŒè¯
â”œâ”€â”€ æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
â”œâ”€â”€ æ›´æ–°ç›¸å…³é…ç½®
â””â”€â”€ æµ‹è¯•å…¶ä»–å·æ­£å¸¸
```

### 4.2 å…·ä½“æ“ä½œç¤ºä¾‹


**åœºæ™¯**ï¼šåˆ é™¤ä¸€ä¸ªåä¸º`lv_oldweb`çš„é€»è¾‘å·

```bash
# ç¬¬1æ­¥ï¼šå¤‡ä»½é‡è¦æ•°æ®
tar -czf /backup/oldweb_backup_$(date +%Y%m%d).tar.gz -C /mnt/oldweb .

# ç¬¬2æ­¥ï¼šåœæ­¢ä½¿ç”¨è¯¥å·çš„æœåŠ¡
systemctl stop httpd
fuser -km /mnt/oldweb  # å¼ºåˆ¶ç»“æŸå ç”¨è¿›ç¨‹

# ç¬¬3æ­¥ï¼šå¸è½½æ–‡ä»¶ç³»ç»Ÿ
umount /mnt/oldweb
# ç¼–è¾‘/etc/fstabï¼Œåˆ é™¤ç›¸å…³æŒ‚è½½æ¡ç›®
sed -i '/lv_oldweb/d' /etc/fstab

# ç¬¬4æ­¥ï¼šåˆ é™¤é€»è¾‘å·
lvremove /dev/vg_web/lv_oldweb

# ç¬¬5æ­¥ï¼šéªŒè¯åˆ é™¤ç»“æžœ
lvs                    # ç¡®è®¤é€»è¾‘å·å·²æ¶ˆå¤±
vgs                    # æŸ¥çœ‹å·ç»„ç©ºé—´æ˜¯å¦å¢žåŠ 
df -h                  # ç¡®è®¤æŒ‚è½½ç‚¹å·²æ¸…ç†
```

### 4.3 å¸è½½æ–‡ä»¶ç³»ç»Ÿè¯¦è§£


**ä¸ºä»€ä¹ˆå¿…é¡»å…ˆå¸è½½**ï¼š
```
Linuxç³»ç»Ÿä¿æŠ¤æœºåˆ¶ï¼š
ä¸å…è®¸åˆ é™¤æ­£åœ¨ä½¿ç”¨çš„é€»è¾‘å·ï¼Œé˜²æ­¢æ•°æ®æŸåå’Œç³»ç»Ÿå´©æºƒ

å¦‚æžœå¼ºåˆ¶åˆ é™¤æŒ‚è½½çš„å·ï¼š
â†’ æ–‡ä»¶ç³»ç»ŸæŸå
â†’ æ­£åœ¨è¿è¡Œçš„ç¨‹åºå´©æºƒ  
â†’ ç³»ç»Ÿå¯èƒ½ä¸ç¨³å®š
```

**ðŸ”¸ å¸è½½æ“ä½œæ–¹æ³•**
```bash
# æ–¹æ³•1ï¼šæŒ‰æŒ‚è½½ç‚¹å¸è½½
umount /mnt/data

# æ–¹æ³•2ï¼šæŒ‰è®¾å¤‡å¸è½½
umount /dev/vg_data/lv_web

# å¼ºåˆ¶å¸è½½(è°¨æ…Žä½¿ç”¨)
umount -f /mnt/data
umount -l /mnt/data    # æ‡’å¸è½½ï¼Œç­‰å¾…è¿›ç¨‹ç»“æŸ
```

**ðŸ”¸ å¤„ç†å¸è½½å¤±è´¥**
```bash
# æŸ¥çœ‹è°åœ¨ä½¿ç”¨
lsof +D /mnt/data
fuser -v /mnt/data

# å¼ºåˆ¶ç»“æŸè¿›ç¨‹
fuser -km /mnt/data

# æŸ¥çœ‹æŒ‚è½½çŠ¶æ€
mount | grep lv_data
```

---

## 5. ðŸ“¦ æ‰¹é‡åˆ é™¤æ“ä½œ


### 5.1 æ‰¹é‡åˆ é™¤çš„ä½¿ç”¨åœºæ™¯


**ðŸ”¸ å…¸åž‹åº”ç”¨åœºæ™¯**
- **æµ‹è¯•çŽ¯å¢ƒæ¸…ç†**ï¼šåˆ é™¤å¤§é‡æµ‹è¯•ç”¨çš„é€»è¾‘å·
- **æ—§é¡¹ç›®æ¸…ç†**ï¼šæ‰¹é‡åˆ é™¤åºŸå¼ƒé¡¹ç›®çš„å­˜å‚¨å·
- **ç³»ç»Ÿé‡æž„**ï¼šé‡æ–°è§„åˆ’å­˜å‚¨ç»“æž„å‰çš„æ¸…ç†
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šè„šæœ¬åŒ–çš„å­˜å‚¨ç®¡ç†

### 5.2 æ‰¹é‡åˆ é™¤æ–¹æ³•


**ðŸ”¸ æ–¹æ³•1ï¼šå¾ªçŽ¯åˆ é™¤æŒ‡å®šå·**
```bash
#!/bin/bash
# æ‰¹é‡åˆ é™¤æŒ‡å®šçš„é€»è¾‘å·åˆ—è¡¨

LV_LIST="lv_test1 lv_test2 lv_test3 lv_old1 lv_old2"
VG_NAME="vg_test"

for lv in $LV_LIST; do
    echo "æ­£åœ¨åˆ é™¤é€»è¾‘å·: $lv"
    
    # æ£€æŸ¥é€»è¾‘å·æ˜¯å¦å­˜åœ¨
    if lvs "$VG_NAME/$lv" >/dev/null 2>&1; then
        # å°è¯•å¸è½½(å¦‚æžœå·²æŒ‚è½½)
        umount "/dev/$VG_NAME/$lv" 2>/dev/null
        
        # åˆ é™¤é€»è¾‘å·
        lvremove -f -y "$VG_NAME/$lv"
        echo "âœ… $lv åˆ é™¤æˆåŠŸ"
    else
        echo "âš ï¸ $lv ä¸å­˜åœ¨ï¼Œè·³è¿‡"
    fi
done
```

**ðŸ”¸ æ–¹æ³•2ï¼šæŒ‰æ¨¡å¼æ‰¹é‡åˆ é™¤**
```bash
#!/bin/bash
# åˆ é™¤æ‰€æœ‰ä»¥"test_"å¼€å¤´çš„é€»è¾‘å·

VG_NAME="vg_data"
PATTERN="test_*"

# èŽ·å–åŒ¹é…çš„é€»è¾‘å·åˆ—è¡¨
LV_LIST=$(lvs --noheadings -o lv_name $VG_NAME | grep "^\s*test_" | tr -d ' ')

for lv in $LV_LIST; do
    echo "æ­£åœ¨åˆ é™¤æµ‹è¯•å·: $lv"
    
    # å¸è½½å¯èƒ½çš„æŒ‚è½½ç‚¹
    MOUNT_POINT=$(mount | grep "$VG_NAME-$lv" | awk '{print $3}')
    if [ ! -z "$MOUNT_POINT" ]; then
        umount "$MOUNT_POINT"
    fi
    
    # åˆ é™¤é€»è¾‘å·
    lvremove -f -y "$VG_NAME/$lv"
done

echo "æ‰¹é‡åˆ é™¤å®Œæˆ"
```

### 5.3 æ‰¹é‡åˆ é™¤çš„å®‰å…¨æŽªæ–½


**ðŸ”¸ åˆ é™¤å‰æ£€æŸ¥æ¸…å•**
```bash
# 1. åˆ—å‡ºå°†è¦åˆ é™¤çš„æ‰€æœ‰é€»è¾‘å·
echo "ä»¥ä¸‹é€»è¾‘å·å°†è¢«åˆ é™¤ï¼š"
lvs vg_test | grep -E "(test_|old_)"

# 2. æ£€æŸ¥æŒ‚è½½çŠ¶æ€
echo "æ£€æŸ¥æŒ‚è½½çŠ¶æ€ï¼š"
mount | grep -E "(test_|old_)"

# 3. ç¡®è®¤æ²¡æœ‰é‡è¦æ•°æ®
read -p "ç¡®è®¤å·²å¤‡ä»½é‡è¦æ•°æ®ï¼Œç»§ç»­åˆ é™¤ï¼Ÿ(yes/no): " confirm
if [ "$confirm" != "yes" ]; then
    echo "æ“ä½œå·²å–æ¶ˆ"
    exit 1
fi
```

---

## 6. ðŸ’¾ åˆ é™¤åŽç©ºé—´ç®¡ç†


### 6.1 ç©ºé—´å›žæ”¶æœºåˆ¶


**é€»è¾‘å·åˆ é™¤åŽç©ºé—´åŽ»å“ªäº†**ï¼š
```
åˆ é™¤å‰ï¼š
å·ç»„ vg_data (100GB)
â”œâ”€â”€ lv_web (30GB)    â† è¦åˆ é™¤çš„å·
â”œâ”€â”€ lv_db (40GB)
â””â”€â”€ å‰©ä½™ç©ºé—´ (30GB)

åˆ é™¤åŽï¼š
å·ç»„ vg_data (100GB)  
â”œâ”€â”€ lv_db (40GB)
â””â”€â”€ å‰©ä½™ç©ºé—´ (60GB)   â† ç©ºé—´è‡ªåŠ¨å›žåˆ°å·ç»„
```

**ðŸ”¸ ç©ºé—´å›žæ”¶éªŒè¯**
```bash
# åˆ é™¤å‰æŸ¥çœ‹ç©ºé—´çŠ¶æ€
vgs vg_data
# è¾“å‡ºï¼švg_data 1 2 0 wz--n- 100.00g 30.00g

# æ‰§è¡Œåˆ é™¤
lvremove -f vg_data/lv_web

# åˆ é™¤åŽæŸ¥çœ‹ç©ºé—´çŠ¶æ€  
vgs vg_data
# è¾“å‡ºï¼švg_data 1 1 0 wz--n- 100.00g 60.00g
#                                    â†‘    â†‘
#                                  æ€»ç©ºé—´ å¯ç”¨ç©ºé—´å¢žåŠ äº†
```

### 6.2 ç©ºé—´é‡æ–°åˆ†é…


**ðŸ”¸ å°†é‡Šæ”¾çš„ç©ºé—´åˆ†é…ç»™å…¶ä»–å·**
```bash
# æ‰©å±•çŽ°æœ‰é€»è¾‘å·
lvextend -L +20G /dev/vg_data/lv_db
resize2fs /dev/vg_data/lv_db

# åˆ›å»ºæ–°çš„é€»è¾‘å·
lvcreate -L 25G -n lv_newapp vg_data
mkfs.ext4 /dev/vg_data/lv_newapp
```

### 6.3 å·ç»„ç©ºé—´ç»Ÿè®¡


**ðŸ”¸ æŸ¥çœ‹ç©ºé—´åˆ†é…è¯¦æƒ…**
```bash
# è¯¦ç»†ç©ºé—´ä¿¡æ¯
vgdisplay vg_data

# ç®€æ´ç©ºé—´ä¿¡æ¯
vgs -o vg_name,vg_size,vg_free,vg_free_count

# æŸ¥çœ‹PE(ç‰©ç†æ‰©å±•)åˆ†é…æƒ…å†µ
vgdisplay -v vg_data | grep -A 10 "PV Name"
```

---

## 7. ðŸ”„ æ„å¤–åˆ é™¤æ¢å¤æ–¹æ³•


### 7.1 é¢„é˜²æ„å¤–åˆ é™¤


**ðŸ”¸ è®¾ç½®åˆ«åé˜²è¯¯æ“ä½œ**
```bash
# åœ¨~/.bashrcä¸­æ·»åŠ å®‰å…¨åˆ«å
alias lvrm='echo "è¯·ä½¿ç”¨å®Œæ•´çš„lvremoveå‘½ä»¤ï¼Œå¹¶ä»”ç»†ç¡®è®¤ï¼"'
alias rm='rm -i'    # rmå‘½ä»¤é»˜è®¤è¯¢é—®ç¡®è®¤
```

**ðŸ”¸ é‡è¦å·çš„ä¿æŠ¤æŽªæ–½**
```bash
# è®¾ç½®é€»è¾‘å·ä¸ºåªè¯»æ¨¡å¼
lvchange -pr /dev/vg_important/lv_critical

# ä½¿ç”¨å¿«ç…§ä¿æŠ¤é‡è¦æ•°æ®
lvcreate -L 5G -s -n lv_critical_snap /dev/vg_important/lv_critical
```

### 7.2 æ¢å¤å¯èƒ½æ€§åˆ†æž


**ðŸ”¸ åˆ é™¤åŽçš„æ•°æ®çŠ¶æ€**
```
åˆšåˆ é™¤æ—¶ï¼š
â€¢ é€»è¾‘å·å…ƒæ•°æ®ï¼šå·²æ¸…é™¤ï¼ŒLVMä¸å†è¯†åˆ«
â€¢ æ–‡ä»¶ç³»ç»Ÿç»“æž„ï¼šå¯èƒ½ä»åœ¨ç£ç›˜ä¸Š  
â€¢ å®žé™…æ•°æ®ï¼šçŸ­æ—¶é—´å†…å¯èƒ½æœªè¢«è¦†ç›–

æ—¶é—´è¶Šé•¿ï¼š
â€¢ æ•°æ®è¢«è¦†ç›–çš„æ¦‚çŽ‡è¶Šé«˜
â€¢ æ¢å¤æˆåŠŸçŽ‡è¶Šä½Ž
â€¢ æ¢å¤æ“ä½œè¶Šå›°éš¾
```

### 7.3 ç´§æ€¥æ¢å¤å°è¯•


**âš ï¸ æ³¨æ„**ï¼šä»¥ä¸‹æ–¹æ³•**æˆåŠŸçŽ‡ä¸é«˜**ï¼Œä¸»è¦ç”¨äºŽç´§æ€¥æƒ…å†µå°è¯•

**ðŸ”¸ æ–¹æ³•1ï¼šå°è¯•é‡å»ºé€»è¾‘å·**
```bash
# 1. ç«‹å³åœæ­¢æ‰€æœ‰å†™å…¥æ“ä½œ
mount -o remount,ro /

# 2. æŸ¥çœ‹LVMå…ƒæ•°æ®å¤‡ä»½
ls /etc/lvm/backup/
ls /etc/lvm/archive/

# 3. å°è¯•æ¢å¤é…ç½®(æžåº¦è°¨æ…Ž)
vgcfgrestore -f /etc/lvm/backup/vg_data vg_data

# 4. æ¿€æ´»é€»è¾‘å·
vgchange -ay vg_data
```

**ðŸ”¸ æ–¹æ³•2ï¼šæ•°æ®æ¢å¤å·¥å…·**
```bash
# ä½¿ç”¨testdiskè¿›è¡Œæ•°æ®æ¢å¤
yum install testdisk
testdisk /dev/sdb    # æŒ‡å‘åŒ…å«æ•°æ®çš„ç‰©ç†è®¾å¤‡

# ä½¿ç”¨photorecæ¢å¤æ–‡ä»¶
photorec /dev/sdb
```

### 7.4 æœ€ä½³æ¢å¤ç­–ç•¥


**ðŸ”¸ ä¼˜å…ˆçº§æŽ’åº**
1. **ä»Žå¤‡ä»½æ¢å¤**ï¼šæœ€å®‰å…¨å¯é çš„æ–¹æ³•
2. **ä»Žå¿«ç…§æ¢å¤**ï¼šå¦‚æžœæœ‰LVMå¿«ç…§
3. **ä»Žé•œåƒæ¢å¤**ï¼šå¦‚æžœè®¾ç½®äº†RAIDé•œåƒ
4. **æ•°æ®æ¢å¤å·¥å…·**ï¼šæœ€åŽçš„å°è¯•æ‰‹æ®µ

**ðŸ’¡ å®žé™…å»ºè®®**
```
çŽ°å®žæƒ…å†µï¼š
â€¢ æ„å¤–åˆ é™¤çš„é€»è¾‘å·å¾ˆéš¾å®Œå…¨æ¢å¤
â€¢ å³ä½¿æ¢å¤ä¹Ÿå¯èƒ½æœ‰æ•°æ®æŸå  
â€¢ æŠ•å…¥çš„æ—¶é—´æˆæœ¬å¾€å¾€å¾ˆé«˜

æœ€å¥½çš„ç­–ç•¥ï¼š
â€¢ å»ºç«‹å®šæœŸå¤‡ä»½æœºåˆ¶
â€¢ é‡è¦æ•°æ®å¤šé‡ä¿æŠ¤
â€¢ æ“ä½œå‰ä»”ç»†æ£€æŸ¥
â€¢ ä½¿ç”¨LVMå¿«ç…§åŠŸèƒ½
```

---

## 8. âœ… æ¸…ç†éªŒè¯ä¸Žæœ€ä½³å®žè·µ


### 8.1 åˆ é™¤åŽéªŒè¯æ£€æŸ¥


**ðŸ”¸ ç³»ç»ŸçŠ¶æ€éªŒè¯æ¸…å•**
```bash
# 1. ç¡®è®¤é€»è¾‘å·å·²å®Œå…¨åˆ é™¤
lvs | grep lv_deleted_name    # åº”è¯¥æ²¡æœ‰è¾“å‡º

# 2. ç¡®è®¤æŒ‚è½½ç‚¹å·²æ¸…ç†
mount | grep lv_deleted_name  # åº”è¯¥æ²¡æœ‰è¾“å‡º
df -h | grep lv_deleted_name  # åº”è¯¥æ²¡æœ‰è¾“å‡º

# 3. ç¡®è®¤/etc/fstabå·²æ›´æ–°
grep lv_deleted_name /etc/fstab  # åº”è¯¥æ²¡æœ‰è¾“å‡º

# 4. éªŒè¯å·ç»„ç©ºé—´å›žæ”¶
vgs vg_name                   # æŸ¥çœ‹Freeç©ºé—´æ˜¯å¦å¢žåŠ 

# 5. ç¡®è®¤å…¶ä»–é€»è¾‘å·æ­£å¸¸
lvs                          # æ£€æŸ¥å…¶ä»–LVçŠ¶æ€
mount -a                     # æµ‹è¯•è‡ªåŠ¨æŒ‚è½½æ˜¯å¦æ­£å¸¸
```

### 8.2 ç³»ç»Ÿé…ç½®æ¸…ç†


**ðŸ”¸ ç›¸å…³é…ç½®æ–‡ä»¶æ¸…ç†**
```bash
# æ¸…ç†/etc/fstabä¸­çš„æŒ‚è½½æ¡ç›®
sed -i '/lv_oldname/d' /etc/fstab

# æ¸…ç†è‡ªå®šä¹‰è„šæœ¬ä¸­çš„å¼•ç”¨
grep -r "lv_oldname" /etc/
grep -r "lv_oldname" /home/scripts/

# æ¸…ç†crontabä»»åŠ¡
crontab -l | grep lv_oldname

# æ£€æŸ¥systemdæœåŠ¡æ–‡ä»¶
systemctl list-unit-files | grep lv_oldname
```

### 8.3 æ“ä½œè®°å½•ä¸Žæ–‡æ¡£


**ðŸ”¸ å»ºç«‹æ“ä½œæ—¥å¿—**
```bash
# è®°å½•åˆ é™¤æ“ä½œ
echo "$(date): åˆ é™¤é€»è¾‘å· vg_data/lv_web, åŽŸå› : é¡¹ç›®ç»“æŸ" >> /var/log/lvm_operations.log

# æ›´æ–°ç³»ç»Ÿæ–‡æ¡£
cat >> /root/lvm_changes.txt << EOF
åˆ é™¤æ—¥æœŸ: $(date)
åˆ é™¤çš„é€»è¾‘å·: vg_data/lv_web  
å¤§å°: 30GB
é‡Šæ”¾ç©ºé—´: å›žåˆ°vg_dataå·ç»„
å¤‡ä»½ä½ç½®: /backup/web_backup_20250120.tar.gz
æ“ä½œäººå‘˜: $(whoami)
EOF
```

### 8.4 æœ€ä½³å®žè·µå»ºè®®


**ðŸ”¸ åˆ é™¤æ“ä½œè§„èŒƒ**

| é˜¶æ®µ | **æœ€ä½³å®žè·µ** |
|------|-------------|
| **åˆ é™¤å‰** | `æ•°æ®å¤‡ä»½ â†’ æœåŠ¡åœæ­¢ â†’ å¸è½½æ–‡ä»¶ç³»ç»Ÿ â†’ åŒé‡ç¡®è®¤` |
| **åˆ é™¤ä¸­** | `ä½¿ç”¨å®Œæ•´è·¯å¾„ â†’ é¿å…é€šé…ç¬¦ â†’ é€ä¸ªæ“ä½œ â†’ è®°å½•æ—¥å¿—` |
| **åˆ é™¤åŽ** | `éªŒè¯çŠ¶æ€ â†’ æ¸…ç†é…ç½® â†’ æµ‹è¯•ç³»ç»Ÿ â†’ æ›´æ–°æ–‡æ¡£` |

**ðŸ”¸ é£Žé™©æŽ§åˆ¶æŽªæ–½**
```bash
# 1. ä¸ºé‡è¦é€»è¾‘å·åˆ›å»ºå¿«ç…§ä¿æŠ¤
lvcreate -L 2G -s -n lv_important_snap /dev/vg_data/lv_important

# 2. å®šæœŸå¤‡ä»½LVMé…ç½®
vgcfgbackup

# 3. ä½¿ç”¨åˆ«åå¢žåŠ å®‰å…¨æç¤º
alias lvremove='echo "âš ï¸ å±é™©æ“ä½œï¼è¯·ç¡®è®¤å¤‡ä»½å’Œå¸è½½"; /sbin/lvremove'

# 4. é‡è¦ç³»ç»Ÿä½¿ç”¨åªè¯»å¿«ç…§
mount -o ro /dev/vg_data/lv_important_snap /mnt/readonly_backup
```

---

## 9. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ åˆ é™¤æœ¬è´¨ï¼šé€»è¾‘å·åˆ é™¤æ˜¯ä¸å¯é€†æ“ä½œï¼Œä¼šå½»åº•æ¸…é™¤æ•°æ®
ðŸ”¸ å‡†å¤‡å·¥ä½œï¼šå¤‡ä»½æ•°æ® â†’ åœæ­¢æœåŠ¡ â†’ å¸è½½æ–‡ä»¶ç³»ç»Ÿ
ðŸ”¸ åˆ é™¤å‘½ä»¤ï¼šlvremoveæ˜¯æ ¸å¿ƒå‘½ä»¤ï¼Œæ”¯æŒå¤šç§å‚æ•°é€‰é¡¹
ðŸ”¸ ç©ºé—´å›žæ”¶ï¼šåˆ é™¤åŽç©ºé—´è‡ªåŠ¨å›žåˆ°å·ç»„ï¼Œå¯é‡æ–°åˆ†é…
ðŸ”¸ æ¢å¤å›°éš¾ï¼šæ„å¤–åˆ é™¤åŽæ¢å¤æˆåŠŸçŽ‡å¾ˆä½Žï¼Œé¢„é˜²å¤§äºŽæ²»ç–—
```

### 9.2 å…³é”®æ“ä½œè¦ç‚¹


**ðŸ”¹ å®‰å…¨åˆ é™¤æµç¨‹**
```
æ ‡å‡†æµç¨‹ï¼šå¤‡ä»½ â†’ åœæœåŠ¡ â†’ å¸è½½ â†’ åˆ é™¤ â†’ éªŒè¯
å…³é”®èŠ‚ç‚¹ï¼šæ¯ä¸€æ­¥éƒ½è¦ç¡®è®¤æˆåŠŸå†è¿›è¡Œä¸‹ä¸€æ­¥
é£Žé™©æŽ§åˆ¶ï¼šé‡è¦æ•°æ®å¿…é¡»æœ‰å¤šé‡ä¿æŠ¤æœºåˆ¶
```

**ðŸ”¹ å¸¸ç”¨å‘½ä»¤ç»„åˆ**
```bash
# æŸ¥çœ‹çŠ¶æ€
lvs, vgs, mount, df -h

# å®‰å…¨åˆ é™¤
umount â†’ lvremove â†’ vgsç¡®è®¤

# æ‰¹é‡å¤„ç†  
è„šæœ¬å¾ªçŽ¯ + é”™è¯¯æ£€æŸ¥ + æ—¥å¿—è®°å½•
```

**ðŸ”¹ æ•…éšœå¤„ç†åŽŸåˆ™**
```
é¢„é˜²ä¼˜å…ˆï¼šå®šæœŸå¤‡ä»½ï¼Œæ“ä½œè§„èŒƒï¼Œå¤šé‡ç¡®è®¤
å¿«é€Ÿå“åº”ï¼šå‘çŽ°è¯¯åˆ ç«‹å³åœæ­¢å†™å…¥ï¼Œå°è¯•æ¢å¤
æ–‡æ¡£è®°å½•ï¼šæ‰€æœ‰æ“ä½œéƒ½è¦æœ‰æ—¥å¿—å’Œæ–‡æ¡£è®°å½•
```

### 9.3 å®žé™…åº”ç”¨æŒ‡å¯¼


**ðŸŽ¯ ä½¿ç”¨åœºæ™¯åˆ¤æ–­**
- **å¼€å‘æµ‹è¯•çŽ¯å¢ƒ**ï¼šå¯ä»¥ç›¸å¯¹å®½æ¾ï¼Œé‡ç‚¹æ˜¯æ•ˆçŽ‡
- **ç”Ÿäº§çŽ¯å¢ƒ**ï¼šå¿…é¡»ä¸¥æ ¼æŒ‰æµç¨‹ï¼Œå®‰å…¨ç¬¬ä¸€
- **æ‰¹é‡æ“ä½œ**ï¼šä½¿ç”¨è„šæœ¬ï¼Œä½†è¦æœ‰å……åˆ†çš„å®‰å…¨æ£€æŸ¥
- **ç´§æ€¥æƒ…å†µ**ï¼šå¯ä»¥ä½¿ç”¨å¼ºåˆ¶å‚æ•°ï¼Œä½†è¦è¯„ä¼°é£Žé™©

**âš ï¸ é£Žé™©æç¤º**
- é€»è¾‘å·åˆ é™¤**æ— æ³•æ’¤é”€**ï¼Œæ“ä½œå‰è¯·ä¸‰æ€
- **å¤‡ä»½æ˜¯å”¯ä¸€å¯é çš„æ•°æ®ä¿æŠ¤æ–¹å¼**
- ç”Ÿäº§çŽ¯å¢ƒæ“ä½œ**å¿…é¡»æœ‰å®¡æ‰¹æµç¨‹**
- é‡è¦æ•°æ®**å»ºè®®ä½¿ç”¨å¿«ç…§ä¿æŠ¤**

**ðŸ“ æ“ä½œå»ºè®®**
- æ–°æ‰‹é˜¶æ®µå…ˆåœ¨æµ‹è¯•çŽ¯å¢ƒç»ƒä¹ 
- åˆ¶å®šæ ‡å‡†çš„æ“ä½œæ£€æŸ¥æ¸…å•  
- å»ºç«‹æ“ä½œæ—¥å¿—å’Œæ–‡æ¡£è®°å½•ä¹ æƒ¯
- é‡è¦æ“ä½œè¦æœ‰åŒäº‹å¤æ ¸ç¡®è®¤

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åˆ é™¤é€»è¾‘å·éœ€è°¨æ…Žï¼Œå¤‡ä»½æ•°æ®æ˜¯å…³é”®
- å¸è½½æ–‡ä»¶ç³»ç»Ÿåœ¨å…ˆï¼Œlvremoveå‘½ä»¤åœ¨åŽ
- ç©ºé—´è‡ªåŠ¨å›žå·ç»„ï¼ŒéªŒè¯æ¸…ç†è¦åšå¥½
- æ„å¤–åˆ é™¤éš¾æ¢å¤ï¼Œé¢„é˜²æŽªæ–½è¦å»ºç«‹