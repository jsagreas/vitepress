---
title: 5、物理卷查看与管理
---
## 📚 目录

1. [物理卷查看概述](#1-物理卷查看概述)
2. [pvdisplay命令详解](#2-pvdisplay命令详解)
3. [pvs命令输出格式与筛选](#3-pvs命令输出格式与筛选)
4. [pvscan命令扫描与缓存](#4-pvscan命令扫描与缓存)
5. [物理卷状态与健康检查](#5-物理卷状态与健康检查)
6. [物理卷空间使用分析](#6-物理卷空间使用分析)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔍 物理卷查看概述


### 1.1 什么是物理卷查看管理


**简单理解**：就像管理仓库一样，你需要随时知道每个仓库（物理卷）里有多少货物（存储空间）、状态如何、是否正常工作。

**核心作用**：
- **监控状态** - 确保存储设备正常工作
- **空间管理** - 了解剩余空间，合理分配
- **故障排查** - 及时发现问题，避免数据丢失
- **性能优化** - 根据使用情况调整配置

### 1.2 物理卷管理的重要性


```
生活类比：
家里的储物柜管理
├── 查看每个柜子的使用情况
├── 检查柜子是否完好
├── 了解剩余空间
└── 合理分配物品存放

LVM物理卷管理
├── 查看PV的使用状态
├── 检查PV健康状况  
├── 监控剩余空间
└── 优化存储分配
```

### 1.3 主要管理工具


| 命令 | **主要用途** | **使用场景** |
|------|-------------|-------------|
| `pvdisplay` | **详细信息查看** | `需要深入了解PV详细配置时` |
| `pvs` | **简洁列表显示** | `快速查看多个PV状态时` |
| `pvscan` | **扫描和缓存** | `系统启动或新增设备时` |

---

## 2. 📊 pvdisplay命令详解


### 2.1 基本功能解释


**pvdisplay**：Physical Volume Display，显示物理卷的详细信息

**通俗理解**：就像给硬盘做"体检报告"，展示所有详细的健康指标和配置信息。

### 2.2 基本使用方法


**查看所有物理卷**：
```bash
pvdisplay
```

**查看特定物理卷**：
```bash
pvdisplay /dev/sdb1
```

### 2.3 输出信息详解


**典型输出示例**：
```
--- Physical volume ---
PV Name               /dev/sdb1          ← 设备路径
VG Name               myVG               ← 所属卷组
PV Size               10.00 GiB / not usable 4.00 MiB    ← 总大小
Allocatable           yes                ← 是否可分配
PE Size               4.00 MiB           ← 物理扩展单元大小
Total PE              2559               ← 总PE数量
Free PE               1279               ← 剩余PE数量
Allocated PE          1280               ← 已分配PE数量
PV UUID               a1b2c3-d4e5-f6g7   ← 唯一标识符
```

### 2.4 关键信息含义解析


**🔸 PV Name（物理卷名称）**
```
含义：设备在系统中的路径
示例：/dev/sdb1、/dev/nvme0n1p1
作用：唯一标识这个存储设备
```

**🔸 VG Name（卷组名称）**
```
含义：这个PV归属的卷组
状态：如果显示空白，说明PV还没有加入任何VG
作用：表明PV的使用归属
```

**🔸 PV Size（物理卷大小）**
```
含义：设备的实际可用大小
格式：总大小 / 不可用空间
示例：10.00 GiB / not usable 4.00 MiB
说明：不可用空间通常是元数据占用
```

**🔸 Allocatable（可分配性）**
```
yes：可以创建新的逻辑卷
no：不能分配新空间（可能正在维护）
作用：控制PV是否参与新的空间分配
```

**🔸 PE相关信息**
```
PE Size：物理扩展单元大小（默认4MB）
Total PE：总共有多少个PE单元
Free PE：还有多少PE可以使用
Allocated PE：已经被使用的PE数量

计算关系：Free PE + Allocated PE = Total PE
```

### 2.5 常用选项参数


**显示更详细信息**：
```bash
pvdisplay -v
```

**以简洁格式显示**：
```bash
pvdisplay -s
```

**仅显示映射信息**：
```bash
pvdisplay -m /dev/sdb1
```

---

## 3. 📋 pvs命令输出格式与筛选


### 3.1 pvs命令基本概念


**pvs**：Physical Volume Show，以表格形式显示物理卷信息

**使用优势**：
- **快速浏览** - 一屏显示多个PV
- **批量对比** - 方便比较不同PV状态
- **脚本友好** - 输出格式适合自动化处理

### 3.2 基本输出格式


**默认输出**：
```bash
pvs
```

**典型显示结果**：
```
PV         VG     Fmt  Attr PSize   PFree
/dev/sdb1  myVG   lvm2 a--  10.00g  5.00g
/dev/sdc1  dataVG lvm2 a--  20.00g  15.00g
/dev/sdd1         lvm2 ---   5.00g   5.00g
```

### 3.3 输出字段含义


| 字段 | **含义** | **示例值** | **说明** |
|------|---------|----------|----------|
| `PV` | **物理卷设备路径** | `/dev/sdb1` | `设备在系统中的位置` |
| `VG` | **所属卷组** | `myVG` | `空白表示未加入VG` |
| `Fmt` | **格式类型** | `lvm2` | `LVM版本格式` |
| `Attr` | **属性标志** | `a--` | `状态和权限标识` |
| `PSize` | **物理卷总大小** | `10.00g` | `可用的总空间` |
| `PFree` | **剩余空间** | `5.00g` | `未分配的空间` |

### 3.4 属性标志详解


**Attr字段的含义**：
```
位置1：分配权限
  a = allocatable（可分配）
  - = not allocatable（不可分配）

位置2：导出状态  
  x = exported（已导出）
  - = not exported（未导出）

位置3：缺失状态
  m = missing（缺失）
  - = not missing（正常）
```

**常见组合示例**：
```
a--：正常可用状态
---：不可分配状态
ax-：已导出状态
a-m：设备缺失状态
```

### 3.5 自定义输出格式


**选择特定字段**：
```bash
pvs -o pv_name,vg_name,pv_size,pv_free
```

**显示所有可用字段**：
```bash
pvs -o +pv_uuid,pe_count,pv_pe_alloc_count
```

**按大小排序**：
```bash
pvs --sort pv_size
```

### 3.6 筛选功能


**查看特定VG的PV**：
```bash
pvs -S vg_name=myVG
```

**查看空闲空间大于1GB的PV**：
```bash
pvs -S 'pv_free>1G'
```

**查看未分配的PV**：
```bash
pvs -S vg_name=""
```

---

## 4. 🔄 pvscan命令扫描与缓存


### 4.1 pvscan功能说明


**pvscan**：Physical Volume Scan，扫描系统中的物理卷

**主要作用**：
- **设备发现** - 找到系统中所有LVM物理卷
- **缓存更新** - 刷新LVM的设备缓存
- **状态同步** - 确保LVM系统状态最新

### 4.2 基本扫描操作


**扫描所有设备**：
```bash
pvscan
```

**典型输出**：
```
PV /dev/sdb1   VG myVG        lvm2 [10.00 GiB / 5.00 GiB free]
PV /dev/sdc1   VG dataVG      lvm2 [20.00 GiB / 15.00 GiB free]
PV /dev/sdd1                  lvm2 [5.00 GiB]
Total: 3 [35.00 GiB] / in use: 2 [30.00 GiB] / in no VG: 1 [5.00 GiB]
```

**输出信息解读**：
```
第一部分：各个PV的状态
├── PV设备路径
├── 所属VG（如果有）
├── 总大小和剩余空间
└── 格式类型

第二部分：统计摘要
├── 总PV数量和空间
├── 使用中的PV情况
└── 未加入VG的PV情况
```

### 4.3 缓存管理功能


**更新设备缓存**：
```bash
pvscan --cache
```

**使用场景**：
- 热插拔存储设备后
- 系统启动时初始化
- 设备配置变更后
- 故障恢复过程中

**清理并重建缓存**：
```bash
pvscan --cache --major 8 --minor 16
```

### 4.4 激活操作


**扫描并激活VG**：
```bash
pvscan --activate ay
```

**激活特定VG**：
```bash
pvscan --activate ay myVG
```

**使用时机**：
```
系统启动过程：
1. 扫描物理卷
2. 识别卷组
3. 激活逻辑卷
4. 挂载文件系统
```

### 4.5 实际应用场景


**🔸 新增硬盘后**
```bash
# 1. 创建物理卷
pvcreate /dev/sde1

# 2. 扫描更新
pvscan --cache

# 3. 验证识别
pvscan
```

**🔸 系统故障恢复**
```bash
# 1. 扫描所有设备
pvscan

# 2. 更新缓存
pvscan --cache

# 3. 激活卷组
pvscan --activate ay
```

---

## 5. ⚡ 物理卷状态与健康检查


### 5.1 物理卷状态类型


**正常状态标识**：
```
┌─────────────────────┐
│      PV状态树       │
├─────────────────────┤
│ ✅ Active          │ ← 正常工作中
│ ✅ Allocatable     │ ← 可以分配空间
│ ⚠️  Read-only       │ ← 只读模式
│ ❌ Missing          │ ← 设备缺失
│ ❌ Failed           │ ← 设备故障
└─────────────────────┘
```

### 5.2 状态检查方法


**使用pvs查看状态**：
```bash
pvs -o +pv_attr,pv_tags
```

**使用pvdisplay详细检查**：
```bash
pvdisplay -v /dev/sdb1
```

### 5.3 常见状态问题


**🔸 设备缺失问题**
```
症状：Attr显示"a-m"
原因：硬盘物理故障或连接问题
处理：
1. 检查硬件连接
2. 查看系统日志
3. 必要时更换设备
```

**🔸 只读状态问题**
```
症状：无法写入数据
原因：文件系统或设备保护
处理：
1. 检查设备权限
2. 查看挂载选项
3. 排查硬件故障
```

### 5.4 健康状态监控


**定期检查脚本示例**：
```bash
#!/bin/bash
# PV健康检查脚本

echo "=== 物理卷健康检查 ==="
date

# 检查所有PV状态
echo "1. PV状态概览："
pvs

# 检查是否有异常PV
echo -e "\n2. 异常状态检查："
pvs -S 'pv_attr=~.*m.*' 2>/dev/null
if [ $? -eq 0 ]; then
    echo "发现缺失的物理卷！"
else
    echo "所有物理卷状态正常"
fi

# 检查剩余空间
echo -e "\n3. 空间使用情况："
pvs -o pv_name,pv_size,pv_free,pv_used --units g
```

### 5.5 故障预警指标


**空间使用率警告**：
```
🟢 < 70%：安全范围
🟡 70-85%：需要关注  
🔴 > 85%：需要扩容
🚨 > 95%：紧急处理
```

**性能监控要点**：
- I/O响应时间
- 错误计数器
- 设备温度
- SMART健康数据

---

## 6. 💾 物理卷空间使用分析


### 6.1 空间使用概念


**空间组成结构**：
```
┌─────────────────────────────────────┐
│           物理卷空间                │
├─────────────────────────────────────┤
│ ████████████ 已使用空间 (60%)      │
│ ░░░░░░░░░░░░ 剩余空间 (40%)        │
│ ▓▓▓▓         元数据空间 (1%)       │
└─────────────────────────────────────┘
```

### 6.2 空间查看方法


**快速查看空间使用**：
```bash
pvs -o pv_name,pv_size,pv_used,pv_free --units g
```

**详细空间分析**：
```bash
pvdisplay /dev/sdb1 | grep -E "Size|Free|Allocated"
```

### 6.3 PE使用情况分析


**PE使用统计**：
```bash
pvs -o pv_name,pe_count,pv_pe_alloc_count,pv_pe_count
```

**输出解读**：
```
PV           PE总数  已分配PE  可用PE
/dev/sdb1    2559   1280     1279
/dev/sdc1    5119   3840     1279

计算使用率：已分配PE / PE总数 × 100%
sdb1使用率：1280/2559 ≈ 50%
sdc1使用率：3840/5119 ≈ 75%
```

### 6.4 空间使用优化建议


**空间分配策略**：

| 使用率范围 | **状态评估** | **建议操作** |
|-----------|-------------|-------------|
| `< 50%` | **充足** | `正常使用` |
| `50-70%` | **正常** | `开始规划扩容` |
| `70-85%` | **紧张** | `准备扩容或清理` |
| `> 85%` | **告警** | `立即扩容` |

**扩容选择方案**：
```
方案1：扩展现有PV
- 适用：物理设备还有空间
- 操作：pvresize命令扩展

方案2：添加新PV  
- 适用：需要更多物理设备
- 操作：pvcreate + vgextend

方案3：数据迁移
- 适用：重新分布数据
- 操作：pvmove命令迁移
```

### 6.5 空间监控脚本


```bash
#!/bin/bash
# PV空间监控脚本

# 设置告警阈值
WARNING_THRESHOLD=70
CRITICAL_THRESHOLD=85

echo "=== 物理卷空间监控 ==="

# 获取PV空间信息
pvs --noheadings -o pv_name,pv_size,pv_used,pv_free --units g | while read pv size used free; do
    # 计算使用率
    size_num=$(echo $size | sed 's/g//')
    used_num=$(echo $used | sed 's/g//')
    
    if [ "$size_num" != "0" ]; then
        usage=$(echo "scale=1; $used_num * 100 / $size_num" | bc)
        
        # 状态判断
        if (( $(echo "$usage > $CRITICAL_THRESHOLD" | bc -l) )); then
            status="🚨 CRITICAL"
        elif (( $(echo "$usage > $WARNING_THRESHOLD" | bc -l) )); then
            status="⚠️  WARNING"
        else
            status="✅ OK"
        fi
        
        printf "%-15s %8s %8s %8s %6.1f%% %s\n" \
               "$pv" "$size" "$used" "$free" "$usage" "$status"
    fi
done
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 物理卷查看：了解存储设备的使用状态和健康情况
🔸 pvdisplay：获取PV的详细配置和状态信息
🔸 pvs命令：快速查看多个PV的关键信息
🔸 pvscan：扫描和管理LVM设备缓存
🔸 状态监控：及时发现和处理物理卷问题
🔸 空间管理：合理规划和使用存储空间
```

### 7.2 关键理解要点


**🔹 三个命令的使用场景**
```
pvdisplay - 深入了解某个PV
├── 查看详细配置信息
├── 故障诊断分析
└── 属性和元数据查看

pvs - 批量查看PV状态
├── 快速状态巡检
├── 空间使用对比
└── 脚本自动化处理

pvscan - 设备发现管理
├── 系统启动初始化
├── 新设备识别
└── 缓存同步更新
```

**🔹 状态监控的重要性**
```
预防性维护：
- 定期检查PV健康状态
- 监控空间使用趋势
- 及时发现潜在问题

故障快速响应：
- 识别设备故障症状
- 定位问题根本原因
- 制定恢复处理方案
```

**🔹 空间管理策略**
```
容量规划：
- 根据业务增长预测需求
- 设置合理的告警阈值
- 制定扩容执行计划

使用优化：
- 定期清理无用数据
- 合理分配逻辑卷大小
- 考虑数据访问模式
```

### 7.3 实际应用价值


**🎯 日常运维场景**
- **系统巡检**：定期检查所有PV状态和空间使用
- **故障处理**：快速定位和解决物理卷问题
- **容量管理**：监控空间使用，规划扩容时机
- **性能优化**：根据PV状态调整存储配置

**🔧 运维最佳实践**
- **自动化监控**：编写脚本定期检查PV状态
- **告警机制**：设置空间和状态告警阈值
- **文档记录**：维护PV配置和变更记录
- **备份策略**：定期备份LVM元数据

### 7.4 故障处理要点


**常见问题处理流程**：
```
问题发现 → 状态确认 → 原因分析 → 制定方案 → 执行处理 → 验证结果

具体步骤：
1. pvs快速查看整体状态
2. pvdisplay详细分析问题PV  
3. pvscan刷新缓存状态
4. 查看系统日志确认原因
5. 执行相应的修复操作
6. 验证修复效果
```

**核心记忆要点**：
- 物理卷管理如同仓库管理，需要清楚库存状态
- pvdisplay看详情，pvs看概览，pvscan做刷新
- 状态监控重于故障处理，预防胜过补救
- 空间使用要规划，告警阈值要合理设置