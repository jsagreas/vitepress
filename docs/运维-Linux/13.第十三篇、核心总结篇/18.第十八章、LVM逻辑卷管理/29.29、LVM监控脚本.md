---
title: 29ã€LVMç›‘æ§è„šæœ¬
---
## ğŸ“š ç›®å½•

1. [LVMç›‘æ§åŸºç¡€æ¦‚å¿µ](#1-LVMç›‘æ§åŸºç¡€æ¦‚å¿µ)
2. [LVMçŠ¶æ€ç›‘æ§è„šæœ¬](#2-LVMçŠ¶æ€ç›‘æ§è„šæœ¬)
3. [ç©ºé—´ä½¿ç”¨å‘Šè­¦ç³»ç»Ÿ](#3-ç©ºé—´ä½¿ç”¨å‘Šè­¦ç³»ç»Ÿ)
4. [æ€§èƒ½æŒ‡æ ‡æ”¶é›†](#4-æ€§èƒ½æŒ‡æ ‡æ”¶é›†)
5. [å¥åº·æ£€æŸ¥è‡ªåŠ¨åŒ–](#5-å¥åº·æ£€æŸ¥è‡ªåŠ¨åŒ–)
6. [æ—¥å¿—åˆ†æè„šæœ¬](#6-æ—¥å¿—åˆ†æè„šæœ¬)
7. [ç›‘æ§æ•°æ®å¯è§†åŒ–](#7-ç›‘æ§æ•°æ®å¯è§†åŒ–)
8. [å‘Šè­¦é€šçŸ¥æœºåˆ¶](#8-å‘Šè­¦é€šçŸ¥æœºåˆ¶)
9. [ç›‘æ§æœ€ä½³å®è·µ](#9-ç›‘æ§æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ LVMç›‘æ§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯LVMç›‘æ§


**LVMç›‘æ§**æ˜¯å¯¹é€»è¾‘å·ç®¡ç†ç³»ç»Ÿè¿›è¡ŒæŒç»­è§‚å¯Ÿå’Œæ£€æµ‹çš„è¿‡ç¨‹ï¼Œç¡®ä¿å­˜å‚¨ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚

```
ç›‘æ§å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–‡ä»¶ç³»ç»Ÿ      â”‚ â† ä½¿ç”¨ç‡ã€inodeæ•°é‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é€»è¾‘å·(LV)    â”‚ â† ç©ºé—´ä½¿ç”¨ã€I/Oæ€§èƒ½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å·ç»„(VG)      â”‚ â† æ€»å®¹é‡ã€å¯ç”¨ç©ºé—´
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç‰©ç†å·(PV)    â”‚ â† ç£ç›˜å¥åº·ã€è¯»å†™çŠ¶æ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦LVMç›‘æ§


**ç›‘æ§çš„é‡è¦æ€§**ï¼š
- **é¢„é˜²æ•…éšœ**ï¼šæå‰å‘ç°é—®é¢˜ï¼Œé¿å…æ•°æ®ä¸¢å¤±
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œä¼˜åŒ–I/O
- **å®¹é‡è§„åˆ’**ï¼šåˆç†åˆ†é…å­˜å‚¨èµ„æº
- **åˆè§„å®¡è®¡**ï¼šæ»¡è¶³ä¼ä¸šITæ²»ç†è¦æ±‚

### 1.3 ç›‘æ§æŒ‡æ ‡ä½“ç³»


**æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**ï¼š

| ç›‘æ§å±‚çº§ | **å…³é”®æŒ‡æ ‡** | **é˜ˆå€¼å»ºè®®** | **ç›‘æ§é¢‘ç‡** |
|---------|-------------|-------------|-------------|
| ğŸ”¸ **ç‰©ç†å·** | `ç£ç›˜ä½¿ç”¨ç‡` | `>85%å‘Šè­¦` | `æ¯5åˆ†é’Ÿ` |
| ğŸ”¸ **å·ç»„** | `å¯ç”¨ç©ºé—´` | `<10%ä¸¥é‡å‘Šè­¦` | `æ¯5åˆ†é’Ÿ` |
| ğŸ”¸ **é€»è¾‘å·** | `ç©ºé—´ä½¿ç”¨ç‡` | `>90%å‘Šè­¦` | `æ¯åˆ†é’Ÿ` |
| ğŸ”¸ **æ–‡ä»¶ç³»ç»Ÿ** | `inodeä½¿ç”¨ç‡` | `>80%å‘Šè­¦` | `æ¯5åˆ†é’Ÿ` |

---

## 2. ğŸ“Š LVMçŠ¶æ€ç›‘æ§è„šæœ¬


### 2.1 åŸºç¡€çŠ¶æ€æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# LVMåŸºç¡€çŠ¶æ€ç›‘æ§è„šæœ¬

# æ£€æŸ¥LVMæœåŠ¡çŠ¶æ€
check_lvm_status() {
    echo "=== LVMæœåŠ¡çŠ¶æ€æ£€æŸ¥ ==="
    
    # æ£€æŸ¥LVMå®ˆæŠ¤è¿›ç¨‹
    if systemctl is-active lvm2-monitor &>/dev/null; then
        echo "âœ… LVMç›‘æ§æœåŠ¡æ­£å¸¸è¿è¡Œ"
    else
        echo "âŒ LVMç›‘æ§æœåŠ¡å¼‚å¸¸"
        return 1
    fi
    
    # æ£€æŸ¥è®¾å¤‡æ˜ å°„
    if ls /dev/mapper/ | grep -q .; then
        echo "âœ… è®¾å¤‡æ˜ å°„æ­£å¸¸"
    else
        echo "âŒ è®¾å¤‡æ˜ å°„å¼‚å¸¸"
        return 1
    fi
}

# æ£€æŸ¥ç‰©ç†å·çŠ¶æ€
check_pv_status() {
    echo "=== ç‰©ç†å·çŠ¶æ€æ£€æŸ¥ ==="
    
    pvs --noheadings -o pv_name,vg_name,pv_attr,pv_size,pv_free | \
    while read pv vg attr size free; do
        # æ£€æŸ¥PVå±æ€§
        if [[ $attr == *"a"* ]]; then
            echo "âœ… $pv: å¯åˆ†é… (${size}æ€»/${free}ç©ºé—²)"
        else
            echo "âš ï¸  $pv: çŠ¶æ€å¼‚å¸¸ ($attr)"
        fi
    done
}

# ä¸»ç¨‹åº
main() {
    echo "LVMçŠ¶æ€ç›‘æ§æŠ¥å‘Š - $(date)"
    echo "================================"
    
    check_lvm_status
    echo
    check_pv_status
}

main
```

### 2.2 è¯¦ç»†ä¿¡æ¯æ”¶é›†è„šæœ¬


```bash
#!/bin/bash
# LVMè¯¦ç»†ä¿¡æ¯æ”¶é›†

collect_lvm_info() {
    local output_file="/tmp/lvm_status_$(date +%Y%m%d_%H%M%S).log"
    
    {
        echo "=== LVMè¯¦ç»†çŠ¶æ€æŠ¥å‘Š ==="
        echo "ç”Ÿæˆæ—¶é—´: $(date)"
        echo "ä¸»æœºå: $(hostname)"
        echo
        
        echo "--- ç‰©ç†å·ä¿¡æ¯ ---"
        pvdisplay
        echo
        
        echo "--- å·ç»„ä¿¡æ¯ ---"
        vgdisplay
        echo
        
        echo "--- é€»è¾‘å·ä¿¡æ¯ ---"
        lvdisplay
        echo
        
        echo "--- æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ ---"
        df -h | grep "/dev/mapper"
        
    } > "$output_file"
    
    echo "è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜åˆ°: $output_file"
}
```

### 2.3 å¿«é€Ÿè¯Šæ–­è„šæœ¬


**ä¸€é”®è¯Šæ–­LVMå¥åº·çŠ¶å†µ**ï¼š

```bash
#!/bin/bash
# LVMå¿«é€Ÿè¯Šæ–­è„šæœ¬

quick_diagnosis() {
    echo "ğŸ” LVMå¿«é€Ÿè¯Šæ–­"
    echo "===================="
    
    # æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡
    echo "ğŸ“Š ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
    df -h | grep -E "(æ–‡ä»¶ç³»ç»Ÿ|Filesystem|/dev/mapper)" | head -1
    df -h | grep "/dev/mapper" | awk '{
        usage = int($5)
        if (usage > 90) status = "âŒ å±é™©"
        else if (usage > 80) status = "âš ï¸  è­¦å‘Š"
        else status = "âœ… æ­£å¸¸"
        printf "%-20s %8s %8s %8s %6s %s\n", $1, $2, $3, $4, $5, status
    }'
    
    echo
    echo "ğŸ’¾ LVMç»„ä»¶æ¦‚è§ˆï¼š"
    printf "%-15s %10s\n" "ç»„ä»¶ç±»å‹" "æ•°é‡"
    printf "%-15s %10s\n" "ç‰©ç†å·" "$(pvs --noheadings | wc -l)"
    printf "%-15s %10s\n" "å·ç»„" "$(vgs --noheadings | wc -l)"
    printf "%-15s %10s\n" "é€»è¾‘å·" "$(lvs --noheadings | wc -l)"
}

quick_diagnosis
```

---

## 3. âš ï¸ ç©ºé—´ä½¿ç”¨å‘Šè­¦ç³»ç»Ÿ


### 3.1 ç©ºé—´ç›‘æ§å‘Šè­¦è„šæœ¬


```bash
#!/bin/bash
# ç©ºé—´ä½¿ç”¨å‘Šè­¦è„šæœ¬

# é…ç½®å‘Šè­¦é˜ˆå€¼
WARNING_THRESHOLD=80    # è­¦å‘Šé˜ˆå€¼
CRITICAL_THRESHOLD=90   # ä¸¥é‡å‘Šè­¦é˜ˆå€¼

check_space_usage() {
    echo "=== ç©ºé—´ä½¿ç”¨å‘Šè­¦æ£€æŸ¥ ==="
    
    # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ç‡
    df -h | grep "/dev/mapper" | while read filesystem size used avail percent mountpoint; do
        # æå–ä½¿ç”¨ç‡æ•°å­—
        usage=$(echo $percent | sed 's/%//')
        
        if [ $usage -ge $CRITICAL_THRESHOLD ]; then
            echo "ğŸš¨ ä¸¥é‡å‘Šè­¦: $mountpoint ä½¿ç”¨ç‡ ${usage}% (é˜ˆå€¼: ${CRITICAL_THRESHOLD}%)"
            # å‘é€å‘Šè­¦é€šçŸ¥
            send_alert "CRITICAL" "$mountpoint" "$usage"
        elif [ $usage -ge $WARNING_THRESHOLD ]; then
            echo "âš ï¸  è­¦å‘Š: $mountpoint ä½¿ç”¨ç‡ ${usage}% (é˜ˆå€¼: ${WARNING_THRESHOLD}%)"
            send_alert "WARNING" "$mountpoint" "$usage"
        else
            echo "âœ… æ­£å¸¸: $mountpoint ä½¿ç”¨ç‡ ${usage}%"
        fi
    done
}

# å‘Šè­¦é€šçŸ¥å‡½æ•°
send_alert() {
    local level=$1
    local mountpoint=$2
    local usage=$3
    
    # å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ é‚®ä»¶ã€çŸ­ä¿¡ç­‰é€šçŸ¥æ–¹å¼
    logger -t "LVM_ALERT" "$level: $mountpoint usage ${usage}%"
    
    # ç¤ºä¾‹ï¼šå‘é€åˆ°ç³»ç»Ÿæ—¥å¿—
    echo "$(date): [$level] $mountpoint ç©ºé—´ä½¿ç”¨ç‡ ${usage}%" >> /var/log/lvm_alerts.log
}

check_space_usage
```

### 3.2 æ™ºèƒ½é¢„æµ‹å‘Šè­¦


**åŸºäºå†å²æ•°æ®é¢„æµ‹ç©ºé—´ä¸è¶³**ï¼š

```bash
#!/bin/bash
# ç©ºé—´å¢é•¿è¶‹åŠ¿åˆ†æ

analyze_growth_trend() {
    local mountpoint=$1
    local history_file="/var/log/lvm_usage_history.log"
    
    # è®°å½•å½“å‰ä½¿ç”¨æƒ…å†µ
    current_usage=$(df -h "$mountpoint" | tail -n1 | awk '{print $5}' | sed 's/%//')
    echo "$(date +%s) $mountpoint $current_usage" >> "$history_file"
    
    # åˆ†ææœ€è¿‘7å¤©çš„å¢é•¿è¶‹åŠ¿
    if [ -f "$history_file" ]; then
        # è·å–7å¤©å‰çš„æ•°æ®
        week_ago=$(date -d "7 days ago" +%s)
        recent_data=$(awk -v start="$week_ago" '$1 >= start' "$history_file" | grep "$mountpoint")
        
        if [ $(echo "$recent_data" | wc -l) -ge 2 ]; then
            # è®¡ç®—å¢é•¿ç‡
            first_usage=$(echo "$recent_data" | head -n1 | awk '{print $3}')
            last_usage=$(echo "$recent_data" | tail -n1 | awk '{print $3}')
            growth_rate=$(echo "scale=2; ($last_usage - $first_usage) / 7" | bc)
            
            echo "ğŸ“ˆ $mountpoint æ—¥å‡å¢é•¿ç‡: ${growth_rate}%"
            
            # é¢„æµ‹æ»¡å®¹æ—¶é—´
            if (( $(echo "$growth_rate > 0" | bc -l) )); then
                days_to_full=$(echo "scale=0; (100 - $current_usage) / $growth_rate" | bc)
                echo "â° é¢„è®¡ $days_to_full å¤©åè¾¾åˆ°100%"
                
                if [ $days_to_full -le 30 ]; then
                    echo "ğŸš¨ è­¦å‘Šï¼š30å¤©å†…å¯èƒ½ç©ºé—´ä¸è¶³ï¼"
                fi
            fi
        fi
    fi
}

# æ£€æŸ¥æ‰€æœ‰LVMæŒ‚è½½ç‚¹
df -h | grep "/dev/mapper" | while read line; do
    mountpoint=$(echo "$line" | awk '{print $6}')
    analyze_growth_trend "$mountpoint"
done
```

---

## 4. ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡æ”¶é›†


### 4.1 I/Oæ€§èƒ½ç›‘æ§


```bash
#!/bin/bash
# LVM I/Oæ€§èƒ½ç›‘æ§è„šæœ¬

collect_io_stats() {
    echo "=== LVM I/Oæ€§èƒ½ç»Ÿè®¡ ==="
    
    # è·å–æ‰€æœ‰LVMè®¾å¤‡
    lvm_devices=$(lvs --noheadings -o lv_path | sed 's|^[[:space:]]*||')
    
    for device in $lvm_devices; do
        device_name=$(basename "$device")
        echo "ğŸ“Š è®¾å¤‡: $device_name"
        
        # ä½¿ç”¨iostatæ”¶é›†I/Oç»Ÿè®¡
        if command -v iostat >/dev/null 2>&1; then
            iostat -x 1 2 | grep "$device_name" | tail -n1 | \
            awk '{
                printf "  è¯»å–: %6s IOPS, %8s KB/s\n", $4, $6
                printf "  å†™å…¥: %6s IOPS, %8s KB/s\n", $5, $7
                printf "  å¹³å‡ç­‰å¾…æ—¶é—´: %6s ms\n", $10
                printf "  è®¾å¤‡åˆ©ç”¨ç‡: %6s%%\n", $12
            }'
        else
            echo "  â„¹ï¸ éœ€è¦å®‰è£…sysstatåŒ…æ¥è·å–è¯¦ç»†I/Oç»Ÿè®¡"
        fi
        echo
    done
}

# ç£ç›˜å»¶è¿Ÿæµ‹è¯•
test_disk_latency() {
    echo "=== ç£ç›˜å»¶è¿Ÿæµ‹è¯• ==="
    
    for device in $(lvs --noheadings -o lv_path); do
        echo "ğŸ” æµ‹è¯•è®¾å¤‡: $(basename $device)"
        
        # ä½¿ç”¨ddæµ‹è¯•è¯»å†™å»¶è¿Ÿ
        echo "  éšæœºè¯»æµ‹è¯•..."
        read_latency=$(dd if="$device" of=/dev/null bs=4k count=1000 iflag=direct 2>&1 | \
                      grep "copied" | awk '{print $(NF-1)}')
        echo "  å¹³å‡è¯»å»¶è¿Ÿ: ${read_latency}s"
        echo
    done
}

collect_io_stats
```

### 4.2 æ€§èƒ½åŸºå‡†æµ‹è¯•


```bash
#!/bin/bash
# LVMæ€§èƒ½åŸºå‡†æµ‹è¯•

benchmark_lvm_performance() {
    local test_file="/tmp/lvm_benchmark"
    local test_size="100M"
    
    echo "ğŸƒ LVMæ€§èƒ½åŸºå‡†æµ‹è¯•"
    echo "æµ‹è¯•æ–‡ä»¶å¤§å°: $test_size"
    echo "========================"
    
    # é¡ºåºå†™æµ‹è¯•
    echo "ğŸ“ é¡ºåºå†™å…¥æµ‹è¯•..."
    write_speed=$(dd if=/dev/zero of="$test_file" bs=1M count=100 2>&1 | \
                 grep "copied" | awk '{print $(NF-3), $(NF-2)}')
    echo "å†™å…¥é€Ÿåº¦: $write_speed"
    
    # é¡ºåºè¯»æµ‹è¯•
    echo "ğŸ“– é¡ºåºè¯»å–æµ‹è¯•..."
    sync && echo 3 > /proc/sys/vm/drop_caches  # æ¸…ç†ç¼“å­˜
    read_speed=$(dd if="$test_file" of=/dev/null bs=1M 2>&1 | \
                grep "copied" | awk '{print $(NF-3), $(NF-2)}')
    echo "è¯»å–é€Ÿåº¦: $read_speed"
    
    # æ¸…ç†æµ‹è¯•æ–‡ä»¶
    rm -f "$test_file"
}

benchmark_lvm_performance
```

---

## 5. ğŸ”§ å¥åº·æ£€æŸ¥è‡ªåŠ¨åŒ–


### 5.1 ç»¼åˆå¥åº·æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# LVMç»¼åˆå¥åº·æ£€æŸ¥è„šæœ¬

LVM_HEALTH_LOG="/var/log/lvm_health.log"

# å¥åº·æ£€æŸ¥ä¸»å‡½æ•°
lvm_health_check() {
    local check_time=$(date "+%Y-%m-%d %H:%M:%S")
    local health_score=100
    local issues=()
    
    echo "ğŸ¥ LVMå¥åº·æ£€æŸ¥æŠ¥å‘Š"
    echo "æ£€æŸ¥æ—¶é—´: $check_time"
    echo "================================"
    
    # æ£€æŸ¥1: ç‰©ç†å·å¥åº·çŠ¶æ€
    echo "ğŸ” æ£€æŸ¥ç‰©ç†å·çŠ¶æ€..."
    while read pv vg attr; do
        if [[ ! $attr == *"a"* ]]; then
            issues+=("ç‰©ç†å· $pv çŠ¶æ€å¼‚å¸¸")
            ((health_score-=10))
        fi
    done < <(pvs --noheadings -o pv_name,vg_name,pv_attr)
    
    # æ£€æŸ¥2: å·ç»„å¯ç”¨ç©ºé—´
    echo "ğŸ” æ£€æŸ¥å·ç»„ç©ºé—´..."
    while read vg vg_free vg_size; do
        free_percent=$(echo "scale=2; $vg_free * 100 / $vg_size" | bc)
        if (( $(echo "$free_percent < 10" | bc -l) )); then
            issues+=("å·ç»„ $vg å¯ç”¨ç©ºé—´ä¸è¶³ (${free_percent}%)")
            ((health_score-=15))
        fi
    done < <(vgs --noheadings -o vg_name,vg_free,vg_size --units=b | \
             awk '{print $1, $2, $3}' | sed 's/B//g')
    
    # æ£€æŸ¥3: é€»è¾‘å·ä¸€è‡´æ€§
    echo "ğŸ” æ£€æŸ¥é€»è¾‘å·ä¸€è‡´æ€§..."
    if ! lvs --noheadings -o lv_name,lv_attr | grep -q "^"; then
        issues+=("æœªå‘ç°é€»è¾‘å·")
        ((health_score-=20))
    fi
    
    # ç”Ÿæˆå¥åº·æŠ¥å‘Š
    generate_health_report "$health_score" "${issues[@]}"
}

# ç”Ÿæˆå¥åº·æŠ¥å‘Š
generate_health_report() {
    local score=$1
    shift
    local issues=("$@")
    
    echo "ğŸ¯ å¥åº·è¯„åˆ†: $score/100"
    
    if [ $score -ge 90 ]; then
        echo "âœ… ç³»ç»Ÿå¥åº·çŠ¶å†µ: ä¼˜ç§€"
    elif [ $score -ge 80 ]; then
        echo "âš ï¸  ç³»ç»Ÿå¥åº·çŠ¶å†µ: è‰¯å¥½"
    elif [ $score -ge 60 ]; then
        echo "ğŸ”¶ ç³»ç»Ÿå¥åº·çŠ¶å†µ: ä¸€èˆ¬"
    else
        echo "âŒ ç³»ç»Ÿå¥åº·çŠ¶å†µ: éœ€è¦å…³æ³¨"
    fi
    
    if [ ${#issues[@]} -gt 0 ]; then
        echo
        echo "ğŸš¨ å‘ç°çš„é—®é¢˜:"
        for issue in "${issues[@]}"; do
            echo "  â€¢ $issue"
        done
    fi
    
    # è®°å½•åˆ°æ—¥å¿—
    echo "$(date): Health Score: $score, Issues: ${#issues[@]}" >> "$LVM_HEALTH_LOG"
}

lvm_health_check
```

### 5.2 è‡ªåŠ¨ä¿®å¤è„šæœ¬


```bash
#!/bin/bash
# LVMè‡ªåŠ¨ä¿®å¤è„šæœ¬

auto_fix_common_issues() {
    echo "ğŸ”§ LVMè‡ªåŠ¨ä¿®å¤ç¨‹åº"
    echo "====================="
    
    # ä¿®å¤1: é‡æ–°æ‰«æPV
    echo "ğŸ”„ é‡æ–°æ‰«æç‰©ç†å·..."
    pvscan --cache
    vgscan --mknodes
    
    # ä¿®å¤2: æ¸…ç†orphan PV
    echo "ğŸ§¹ æ¸…ç†å­¤ç«‹çš„ç‰©ç†å·..."
    orphan_pvs=$(pvs --noheadings -o pv_name,vg_name | awk '$2=="" {print $1}')
    if [ -n "$orphan_pvs" ]; then
        echo "å‘ç°å­¤ç«‹PV: $orphan_pvs"
        echo "âš ï¸  éœ€è¦æ‰‹åŠ¨å¤„ç†å­¤ç«‹çš„ç‰©ç†å·"
    fi
    
    # ä¿®å¤3: æ£€æŸ¥å¹¶ä¿®å¤æ–‡ä»¶ç³»ç»Ÿ
    echo "ğŸ” æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ..."
    for lv in $(lvs --noheadings -o lv_path); do
        if mount | grep -q "$lv"; then
            echo "â­ï¸  è·³è¿‡å·²æŒ‚è½½çš„ $lv"
        else
            echo "ğŸ”§ æ£€æŸ¥ $lv çš„æ–‡ä»¶ç³»ç»Ÿ..."
            fsck -n "$lv" 2>/dev/null || echo "  éœ€è¦æ‰‹åŠ¨æ£€æŸ¥ $lv"
        fi
    done
    
    echo "âœ… è‡ªåŠ¨ä¿®å¤å®Œæˆ"
}

auto_fix_common_issues
```

---

## 6. ğŸ“ æ—¥å¿—åˆ†æè„šæœ¬


### 6.1 LVMæ—¥å¿—åˆ†æ


```bash
#!/bin/bash
# LVMæ—¥å¿—åˆ†æè„šæœ¬

analyze_lvm_logs() {
    echo "ğŸ“‹ LVMæ—¥å¿—åˆ†ææŠ¥å‘Š"
    echo "==================="
    
    # åˆ†æç³»ç»Ÿæ—¥å¿—ä¸­çš„LVMç›¸å…³ä¿¡æ¯
    local log_file="/var/log/messages"
    local today=$(date "+%b %d")
    
    echo "ğŸ” ä»Šæ—¥LVMç›¸å…³æ—¥å¿—:"
    
    # é”™è¯¯æ—¥å¿—
    lvm_errors=$(grep "$today" "$log_file" 2>/dev/null | \
                grep -i "lvm\|mapper" | grep -i "error\|fail\|warn")
    
    if [ -n "$lvm_errors" ]; then
        echo "âŒ å‘ç°é”™è¯¯æ—¥å¿—:"
        echo "$lvm_errors" | while read line; do
            echo "  â€¢ $line"
        done
    else
        echo "âœ… æœªå‘ç°é”™è¯¯æ—¥å¿—"
    fi
    
    # ç»Ÿè®¡æ“ä½œæ—¥å¿—
    echo
    echo "ğŸ“Š æ“ä½œç»Ÿè®¡:"
    
    operations=(
        "lvcreate:åˆ›å»ºé€»è¾‘å·"
        "lvextend:æ‰©å±•é€»è¾‘å·"
        "lvremove:åˆ é™¤é€»è¾‘å·"
        "vgcreate:åˆ›å»ºå·ç»„"
        "vgextend:æ‰©å±•å·ç»„"
        "pvcreate:åˆ›å»ºç‰©ç†å·"
    )
    
    for op in "${operations[@]}"; do
        cmd=$(echo "$op" | cut -d: -f1)
        desc=$(echo "$op" | cut -d: -f2)
        count=$(grep "$today" "$log_file" 2>/dev/null | grep -c "$cmd")
        printf "  %-15s: %d æ¬¡æ“ä½œ\n" "$desc" "$count"
    done
}

# æ—¥å¿—è½®è½¬å’Œæ¸…ç†
manage_lvm_logs() {
    echo
    echo "ğŸ—‚ï¸  æ—¥å¿—ç®¡ç†"
    echo "============"
    
    local log_dir="/var/log/lvm"
    mkdir -p "$log_dir"
    
    # å½’æ¡£æ—§æ—¥å¿—
    if [ -f "/var/log/lvm_alerts.log" ]; then
        log_size=$(stat -f%z "/var/log/lvm_alerts.log" 2>/dev/null || stat -c%s "/var/log/lvm_alerts.log")
        if [ $log_size -gt 10485760 ]; then  # 10MB
            mv "/var/log/lvm_alerts.log" "/var/log/lvm/alerts_$(date +%Y%m%d).log"
            touch "/var/log/lvm_alerts.log"
            echo "âœ… å·²å½’æ¡£å‘Šè­¦æ—¥å¿—"
        fi
    fi
}

analyze_lvm_logs
manage_lvm_logs
```

### 6.2 æ€§èƒ½å†å²åˆ†æ


```bash
#!/bin/bash
# LVMæ€§èƒ½å†å²åˆ†æ

performance_history_analysis() {
    local history_file="/var/log/lvm_performance.log"
    
    echo "ğŸ“ˆ LVMæ€§èƒ½å†å²åˆ†æ"
    echo "=================="
    
    if [ ! -f "$history_file" ]; then
        echo "âš ï¸  æ€§èƒ½å†å²æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¼€å§‹æ”¶é›†..."
        # åˆå§‹åŒ–æ€§èƒ½è®°å½•
        collect_current_performance > "$history_file"
        return
    fi
    
    # åˆ†ææœ€è¿‘7å¤©çš„æ€§èƒ½è¶‹åŠ¿
    echo "ğŸ“Š æœ€è¿‘7å¤©æ€§èƒ½è¶‹åŠ¿:"
    
    # æ˜¾ç¤ºç£ç›˜ä½¿ç”¨ç‡è¶‹åŠ¿
    tail -n 168 "$history_file" | awk '
    /disk_usage/ {
        date = $1 " " $2
        device = $3
        usage = $4
        if (device in last_usage) {
            change = usage - last_usage[device]
            if (change > 5) status = "ğŸ“ˆ å¢é•¿"
            else if (change < -5) status = "ğŸ“‰ ä¸‹é™" 
            else status = "â¡ï¸  ç¨³å®š"
            printf "%s %s: %s%% (%s)\n", date, device, usage, status
        }
        last_usage[device] = usage
    }'
}

# æ”¶é›†å½“å‰æ€§èƒ½æ•°æ®
collect_current_performance() {
    local timestamp=$(date "+%Y-%m-%d %H:%M:%S")
    
    # è®°å½•ç£ç›˜ä½¿ç”¨ç‡
    df -h | grep "/dev/mapper" | while read line; do
        device=$(echo "$line" | awk '{print $1}')
        usage=$(echo "$line" | awk '{print $5}' | sed 's/%//')
        echo "$timestamp disk_usage $device $usage"
    done
    
    # è®°å½•I/Oç»Ÿè®¡
    if command -v iostat >/dev/null 2>&1; then
        iostat -x 1 1 | grep -E "^(dm-|mapper)" | while read line; do
            device=$(echo "$line" | awk '{print $1}')
            iops=$(echo "$line" | awk '{print $4+$5}')
            echo "$timestamp io_stats $device $iops"
        done
    fi
}

performance_history_analysis
```

---

## 7. ğŸ“Š ç›‘æ§æ•°æ®å¯è§†åŒ–


### 7.1 ASCIIå›¾è¡¨ç”Ÿæˆ


```bash
#!/bin/bash
# ç”ŸæˆASCIIå›¾è¡¨å±•ç¤ºLVMçŠ¶æ€

generate_ascii_chart() {
    echo "ğŸ“Š LVMä½¿ç”¨ç‡å¯è§†åŒ–"
    echo "=================="
    
    # ç”Ÿæˆç£ç›˜ä½¿ç”¨ç‡æ¡å½¢å›¾
    df -h | grep "/dev/mapper" | while read filesystem size used avail percent mountpoint; do
        usage=$(echo $percent | sed 's/%//')
        device_name=$(basename "$filesystem")
        
        # ç”Ÿæˆè¿›åº¦æ¡ (50å­—ç¬¦å®½åº¦)
        filled=$((usage * 50 / 100))
        empty=$((50 - filled))
        
        printf "%-20s [" "$device_name"
        
        # æ ¹æ®ä½¿ç”¨ç‡é€‰æ‹©é¢œè‰²å­—ç¬¦
        if [ $usage -ge 90 ]; then
            char="â–ˆ"  # å±é™© - çº¢è‰²æ•ˆæœ
        elif [ $usage -ge 80 ]; then
            char="â–“"  # è­¦å‘Š - é»„è‰²æ•ˆæœ
        else
            char="â–’"  # æ­£å¸¸ - ç»¿è‰²æ•ˆæœ
        fi
        
        # ç»˜åˆ¶å¡«å……éƒ¨åˆ†
        for ((i=1; i<=filled; i++)); do
            printf "$char"
        done
        
        # ç»˜åˆ¶ç©ºç™½éƒ¨åˆ†
        for ((i=1; i<=empty; i++)); do
            printf "â–‘"
        done
        
        printf "] %3d%% (%s/%s)\n" "$usage" "$used" "$size"
    done
}

# ç”ŸæˆLVMå±‚æ¬¡ç»“æ„å›¾
generate_lvm_hierarchy() {
    echo
    echo "ğŸ—ï¸  LVMå±‚æ¬¡ç»“æ„"
    echo "==============="
    
    # æ˜¾ç¤ºå·ç»„åŠå…¶é€»è¾‘å·
    vgs --noheadings -o vg_name | while read vg; do
        echo "ğŸ“¦ å·ç»„: $vg"
        
        # æ˜¾ç¤ºè¯¥å·ç»„çš„é€»è¾‘å·
        lvs --noheadings -o lv_name,lv_size -S vg_name="$vg" | while read lv size; do
            echo "  â”œâ”€ ğŸ“‚ $lv ($size)"
            
            # æ£€æŸ¥æŒ‚è½½ç‚¹
            mount_point=$(mount | grep "/dev/mapper/$vg-$lv" | awk '{print $3}')
            if [ -n "$mount_point" ]; then
                echo "  â”‚   â””â”€ ğŸ“ æŒ‚è½½äº: $mount_point"
            fi
        done
        
        # æ˜¾ç¤ºè¯¥å·ç»„çš„ç‰©ç†å·
        echo "  â””â”€ ç‰©ç†å·:"
        pvs --noheadings -o pv_name,pv_size -S vg_name="$vg" | while read pv size; do
            echo "      â””â”€ ğŸ’½ $pv ($size)"
        done
        echo
    done
}

generate_ascii_chart
generate_lvm_hierarchy
```

### 7.2 çŠ¶æ€ä»ªè¡¨æ¿


```bash
#!/bin/bash
# LVMçŠ¶æ€ä»ªè¡¨æ¿

create_dashboard() {
    clear
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                      LVM ç›‘æ§ä»ªè¡¨æ¿                            â•‘"
    echo "â•‘                 æ›´æ–°æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')                â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    
    # ç³»ç»Ÿæ¦‚è§ˆ
    echo "â•‘ ğŸ–¥ï¸  ç³»ç»Ÿæ¦‚è§ˆ                                                   â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    
    # ç»Ÿè®¡ä¿¡æ¯
    pv_count=$(pvs --noheadings | wc -l)
    vg_count=$(vgs --noheadings | wc -l)
    lv_count=$(lvs --noheadings | wc -l)
    
    printf "â•‘ ç‰©ç†å·: %2d ä¸ª    å·ç»„: %2d ä¸ª    é€»è¾‘å·: %2d ä¸ª            â•‘\n" \
           "$pv_count" "$vg_count" "$lv_count"
    
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "â•‘ ğŸ“Š ç©ºé—´ä½¿ç”¨çŠ¶å†µ                                                â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    
    # ç©ºé—´ä½¿ç”¨æƒ…å†µ
    df -h | grep "/dev/mapper" | while read filesystem size used avail percent mountpoint; do
        usage=$(echo $percent | sed 's/%//')
        device=$(basename "$filesystem")
        
        # çŠ¶æ€å›¾æ ‡
        if [ $usage -ge 90 ]; then
            status="ğŸ”´"
        elif [ $usage -ge 80 ]; then
            status="ğŸŸ¡"
        else
            status="ğŸŸ¢"
        fi
        
        printf "â•‘ %s %-15s %6s %6s %6s %10s        â•‘\n" \
               "$status" "$device" "$size" "$used" "$avail" "$mountpoint"
    done
    
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}

# å®æ—¶ç›‘æ§æ¨¡å¼
real_time_monitor() {
    while true; do
        create_dashboard
        echo
        echo "æŒ‰ Ctrl+C é€€å‡ºç›‘æ§æ¨¡å¼..."
        sleep 5
    done
}

# æ£€æŸ¥æ˜¯å¦å¯ç”¨å®æ—¶æ¨¡å¼
if [ "$1" == "--realtime" ]; then
    real_time_monitor
else
    create_dashboard
fi
```

---

## 8. ğŸ“¢ å‘Šè­¦é€šçŸ¥æœºåˆ¶


### 8.1 å¤šæ¸ é“å‘Šè­¦é€šçŸ¥


```bash
#!/bin/bash
# å¤šæ¸ é“å‘Šè­¦é€šçŸ¥ç³»ç»Ÿ

# å‘Šè­¦é…ç½®
ALERT_CONFIG="/etc/lvm-monitor/alert.conf"
EMAIL_RECIPIENTS="admin@example.com"
WEBHOOK_URL="https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"

# å‘é€é‚®ä»¶å‘Šè­¦
send_email_alert() {
    local level=$1
    local message=$2
    local subject="LVM $level Alert - $(hostname)"
    
    if command -v mail >/dev/null 2>&1; then
        echo "$message" | mail -s "$subject" "$EMAIL_RECIPIENTS"
        echo "âœ… é‚®ä»¶å‘Šè­¦å·²å‘é€"
    else
        echo "âš ï¸  é‚®ä»¶å‘½ä»¤ä¸å¯ç”¨"
    fi
}

# å‘é€Webhookå‘Šè­¦
send_webhook_alert() {
    local level=$1
    local message=$2
    
    if [ -n "$WEBHOOK_URL" ]; then
        curl -X POST -H 'Content-type: application/json' \
             --data "{\"text\":\"ğŸš¨ LVM $level Alert\\n$message\"}" \
             "$WEBHOOK_URL" 2>/dev/null
        echo "âœ… Webhookå‘Šè­¦å·²å‘é€"
    fi
}

# å‘é€ç³»ç»Ÿé€šçŸ¥
send_system_notification() {
    local level=$1
    local message=$2
    
    # è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—
    logger -t "LVM_MONITOR" -p daemon.warn "$level: $message"
    
    # å‘é€æ¡Œé¢é€šçŸ¥
    if command -v notify-send >/dev/null 2>&1; then
        notify-send "LVM $level" "$message" -u critical
    fi
}

# ç»Ÿä¸€å‘Šè­¦æ¥å£
send_alert() {
    local level=$1
    local title=$2
    local details=$3
    
    local timestamp=$(date "+%Y-%m-%d %H:%M:%S")
    local hostname=$(hostname)
    local message="æ—¶é—´: $timestamp
ä¸»æœº: $hostname
çº§åˆ«: $level
æ ‡é¢˜: $title
è¯¦æƒ…: $details"
    
    echo "ğŸ“¢ å‘é€ $level çº§åˆ«å‘Šè­¦: $title"
    
    # æ ¹æ®å‘Šè­¦çº§åˆ«é€‰æ‹©é€šçŸ¥æ¸ é“
    case $level in
        "CRITICAL")
            send_email_alert "$level" "$message"
            send_webhook_alert "$level" "$message"
            send_system_notification "$level" "$message"
            ;;
        "WARNING")
            send_webhook_alert "$level" "$message"
            send_system_notification "$level" "$message"
            ;;
        "INFO")
            send_system_notification "$level" "$message"
            ;;
    esac
    
    # è®°å½•å‘Šè­¦å†å²
    echo "$timestamp|$level|$title|$details" >> /var/log/lvm_alerts_history.log
}

# ç¤ºä¾‹ä½¿ç”¨
if [ $# -ge 3 ]; then
    send_alert "$1" "$2" "$3"
else
    echo "ç”¨æ³•: $0 <çº§åˆ«> <æ ‡é¢˜> <è¯¦æƒ…>"
    echo "çº§åˆ«: CRITICAL, WARNING, INFO"
fi
```

### 8.2 å‘Šè­¦æŠ‘åˆ¶å’Œå‡çº§


```bash
#!/bin/bash
# å‘Šè­¦æŠ‘åˆ¶å’Œå‡çº§æœºåˆ¶

ALERT_STATE_FILE="/tmp/lvm_alert_states"

# æ£€æŸ¥å‘Šè­¦æŠ‘åˆ¶
check_alert_suppression() {
    local alert_key=$1
    local current_time=$(date +%s)
    local suppression_time=3600  # 1å°æ—¶æŠ‘åˆ¶æœŸ
    
    if [ -f "$ALERT_STATE_FILE" ]; then
        last_alert=$(grep "^$alert_key:" "$ALERT_STATE_FILE" | cut -d: -f2)
        if [ -n "$last_alert" ]; then
            time_diff=$((current_time - last_alert))
            if [ $time_diff -lt $suppression_time ]; then
                echo "å‘Šè­¦å·²æŠ‘åˆ¶ (è¿˜éœ€ç­‰å¾… $((suppression_time - time_diff)) ç§’)"
                return 1
            fi
        fi
    fi
    
    # æ›´æ–°å‘Šè­¦çŠ¶æ€
    grep -v "^$alert_key:" "$ALERT_STATE_FILE" 2>/dev/null > "${ALERT_STATE_FILE}.tmp"
    echo "$alert_key:$current_time" >> "${ALERT_STATE_FILE}.tmp"
    mv "${ALERT_STATE_FILE}.tmp" "$ALERT_STATE_FILE"
    
    return 0
}

# å‘Šè­¦å‡çº§æœºåˆ¶
escalate_alert() {
    local alert_key=$1
    local escalation_file="/tmp/lvm_escalation_$alert_key"
    local current_time=$(date +%s)
    
    if [ -f "$escalation_file" ]; then
        escalation_count=$(cat "$escalation_file")
        escalation_count=$((escalation_count + 1))
    else
        escalation_count=1
    fi
    
    echo $escalation_count > "$escalation_file"
    
    # æ ¹æ®å‡çº§æ¬¡æ•°è°ƒæ•´å‘Šè­¦çº§åˆ«
    if [ $escalation_count -ge 3 ]; then
        echo "CRITICAL"
    elif [ $escalation_count -ge 2 ]; then
        echo "WARNING"
    else
        echo "INFO"
    fi
}

# æ™ºèƒ½å‘Šè­¦å‘é€
smart_alert() {
    local base_level=$1
    local alert_key=$2
    local title=$3
    local details=$4
    
    # æ£€æŸ¥æ˜¯å¦éœ€è¦æŠ‘åˆ¶
    if ! check_alert_suppression "$alert_key"; then
        return
    fi
    
    # æ£€æŸ¥æ˜¯å¦éœ€è¦å‡çº§
    escalated_level=$(escalate_alert "$alert_key")
    
    # å‘é€å‘Šè­¦
    send_alert "$escalated_level" "$title" "$details"
}
```

---

## 9. ğŸ¯ ç›‘æ§æœ€ä½³å®è·µ


### 9.1 ç›‘æ§ç­–ç•¥è®¾è®¡


**ç›‘æ§é¢‘ç‡å»ºè®®**ï¼š

```
é«˜é¢‘ç›‘æ§ (æ¯åˆ†é’Ÿ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ ç£ç›˜ä½¿ç”¨ç‡    â”‚ â† å¿«é€Ÿå˜åŒ–ï¼Œéœ€è¦åŠæ—¶å‘ç°
â”‚ â€¢ I/Oé”™è¯¯è®¡æ•°   â”‚ â† ç¡¬ä»¶æ•…éšœæŒ‡æ ‡
â”‚ â€¢ æŒ‚è½½çŠ¶æ€      â”‚ â† æœåŠ¡å¯ç”¨æ€§å…³é”®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸­é¢‘ç›‘æ§ (æ¯5åˆ†é’Ÿ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ æ€§èƒ½æŒ‡æ ‡      â”‚ â† I/Oååé‡ã€å»¶è¿Ÿ
â”‚ â€¢ VGå¯ç”¨ç©ºé—´    â”‚ â† å®¹é‡è§„åˆ’
â”‚ â€¢ PVå¥åº·çŠ¶æ€    â”‚ â† ç¡¬ä»¶å¥åº·æ£€æŸ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½é¢‘ç›‘æ§ (æ¯å°æ—¶):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ é…ç½®å˜æ›´      â”‚ â† å®¡è®¡è·Ÿè¸ª
â”‚ â€¢ å†å²è¶‹åŠ¿      â”‚ â† é•¿æœŸåˆ†æ
â”‚ â€¢ å¤‡ä»½çŠ¶æ€      â”‚ â† æ•°æ®ä¿æŠ¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 å‘Šè­¦é˜ˆå€¼ä¼˜åŒ–


**åŠ¨æ€é˜ˆå€¼è°ƒæ•´**ï¼š

```bash
#!/bin/bash
# åŠ¨æ€å‘Šè­¦é˜ˆå€¼ä¼˜åŒ–

optimize_thresholds() {
    local device=$1
    local history_file="/var/log/lvm_usage_history.log"
    
    # è®¡ç®—å†å²å¹³å‡ä½¿ç”¨ç‡
    avg_usage=$(grep "$device" "$history_file" | \
               awk '{sum+=$3; count++} END {print sum/count}')
    
    # è®¡ç®—æ ‡å‡†å·®
    std_dev=$(grep "$device" "$history_file" | \
             awk -v avg="$avg_usage" '{
                 sum += ($3 - avg) ^ 2; count++
             } END {
                 print sqrt(sum/count)
             }')
    
    # åŠ¨æ€è°ƒæ•´é˜ˆå€¼
    warning_threshold=$(echo "$avg_usage + 2 * $std_dev" | bc)
    critical_threshold=$(echo "$avg_usage + 3 * $std_dev" | bc)
    
    echo "è®¾å¤‡ $device ä¼˜åŒ–åçš„é˜ˆå€¼:"
    echo "  è­¦å‘Šé˜ˆå€¼: ${warning_threshold}%"
    echo "  ä¸¥é‡é˜ˆå€¼: ${critical_threshold}%"
}
```

### 9.3 ç›‘æ§è„šæœ¬éƒ¨ç½²


**Crontabé…ç½®ç¤ºä¾‹**ï¼š

```bash
# LVMç›‘æ§ä»»åŠ¡è®¡åˆ’
# ç¼–è¾‘: crontab -e

# æ¯åˆ†é’Ÿæ£€æŸ¥å…³é”®æŒ‡æ ‡
* * * * * /opt/lvm-monitor/scripts/quick_check.sh

# æ¯5åˆ†é’Ÿæ£€æŸ¥è¯¦ç»†çŠ¶æ€
*/5 * * * * /opt/lvm-monitor/scripts/detailed_check.sh

# æ¯15åˆ†é’Ÿæ”¶é›†æ€§èƒ½æ•°æ®
*/15 * * * * /opt/lvm-monitor/scripts/collect_performance.sh

# æ¯å°æ—¶æ‰§è¡Œå¥åº·æ£€æŸ¥
0 * * * * /opt/lvm-monitor/scripts/health_check.sh

# æ¯å¤©å‡Œæ™¨2ç‚¹ç”ŸæˆæŠ¥å‘Š
0 2 * * * /opt/lvm-monitor/scripts/daily_report.sh

# æ¯å‘¨æ—¥è¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
0 3 * * 0 /opt/lvm-monitor/scripts/benchmark.sh
```

### 9.4 ç›‘æ§ç³»ç»Ÿç»´æŠ¤


```bash
#!/bin/bash
# ç›‘æ§ç³»ç»Ÿç»´æŠ¤è„šæœ¬

maintain_monitoring_system() {
    echo "ğŸ”§ ç›‘æ§ç³»ç»Ÿç»´æŠ¤"
    echo "==============="
    
    # 1. æ¸…ç†æ—§æ—¥å¿—
    echo "ğŸ—‚ï¸  æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶..."
    find /var/log/lvm* -name "*.log" -mtime +30 -delete
    echo "âœ… å·²æ¸…ç†30å¤©å‰çš„æ—¥å¿—"
    
    # 2. å‹ç¼©å†å²æ•°æ®
    echo "ğŸ“¦ å‹ç¼©å†å²æ•°æ®..."
    find /var/log -name "lvm_*" -mtime +7 -exec gzip {} \;
    echo "âœ… å·²å‹ç¼©7å¤©å‰çš„æ•°æ®"
    
    # 3. æ£€æŸ¥ç›‘æ§è„šæœ¬çŠ¶æ€
    echo "ğŸ” æ£€æŸ¥ç›‘æ§è„šæœ¬..."
    if ps aux | grep -v grep | grep -q "lvm-monitor"; then
        echo "âœ… ç›‘æ§è¿›ç¨‹æ­£å¸¸è¿è¡Œ"
    else
        echo "âš ï¸  ç›‘æ§è¿›ç¨‹æœªè¿è¡Œï¼Œå°è¯•é‡å¯..."
        systemctl restart lvm-monitor 2>/dev/null || echo "éœ€è¦æ‰‹åŠ¨æ£€æŸ¥"
    fi
    
    # 4. éªŒè¯é…ç½®æ–‡ä»¶
    echo "ğŸ“‹ éªŒè¯é…ç½®æ–‡ä»¶..."
    config_files=(
        "/etc/lvm-monitor/alert.conf"
        "/etc/lvm-monitor/thresholds.conf"
    )
    
    for config in "${config_files[@]}"; do
        if [ -f "$config" ]; then
            echo "âœ… $config å­˜åœ¨"
        else
            echo "âš ï¸  $config ç¼ºå¤±ï¼Œéœ€è¦åˆ›å»º"
        fi
    done
    
    echo "ğŸ‰ ç»´æŠ¤å®Œæˆ"
}

maintain_monitoring_system
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç›‘æ§å¯¹è±¡ï¼šç‰©ç†å·ã€å·ç»„ã€é€»è¾‘å·ã€æ–‡ä»¶ç³»ç»Ÿå››ä¸ªå±‚æ¬¡
ğŸ”¸ ç›‘æ§æŒ‡æ ‡ï¼šç©ºé—´ä½¿ç”¨ç‡ã€I/Oæ€§èƒ½ã€å¥åº·çŠ¶æ€ã€é”™è¯¯è®¡æ•°
ğŸ”¸ å‘Šè­¦æœºåˆ¶ï¼šå¤šçº§å‘Šè­¦ã€å¤šæ¸ é“é€šçŸ¥ã€æŠ‘åˆ¶å’Œå‡çº§
ğŸ”¸ è‡ªåŠ¨åŒ–ï¼šçŠ¶æ€æ£€æŸ¥ã€æ€§èƒ½æ”¶é›†ã€é—®é¢˜ä¿®å¤ã€æŠ¥å‘Šç”Ÿæˆ
ğŸ”¸ å¯è§†åŒ–ï¼šASCIIå›¾è¡¨ã€ä»ªè¡¨æ¿ã€è¶‹åŠ¿åˆ†æã€å±‚æ¬¡å±•ç¤º
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§ä¸æ˜¯ç›®çš„ï¼Œä¿éšœä¸šåŠ¡è¿ç»­æ€§æ‰æ˜¯**
```
ç›‘æ§çš„ä»·å€¼ï¼š
â€¢ é¢„é˜² > å‘ç° > å¤„ç†
â€¢ æå‰é¢„è­¦æ¯”äº‹åè¡¥æ•‘æ›´é‡è¦
â€¢ è‡ªåŠ¨åŒ–å“åº”å‡å°‘äººå·¥å¹²é¢„
â€¢ å†å²æ•°æ®æŒ‡å¯¼å®¹é‡è§„åˆ’
```

**ğŸ”¹ å‘Šè­¦è¦æœ‰ä»·å€¼ï¼Œé¿å…å‘Šè­¦ç–²åŠ³**
```
æœ‰æ•ˆå‘Šè­¦çš„ç‰¹ç‚¹ï¼š
â€¢ å¯æ“ä½œï¼šæ”¶åˆ°å‘Šè­¦çŸ¥é“è¯¥åšä»€ä¹ˆ
â€¢ æœ‰æ—¶æ•ˆï¼šé—®é¢˜ç´§æ€¥ç¨‹åº¦ä¸é€šçŸ¥æ–¹å¼åŒ¹é…
â€¢ ä¸é‡å¤ï¼šç›¸åŒé—®é¢˜ä¸åå¤å‘Šè­¦
â€¢ åˆ†çº§åˆ«ï¼šä¸åŒä¸¥é‡ç¨‹åº¦åŒºåˆ«å¯¹å¾…
```

**ğŸ”¹ ç›‘æ§æ•°æ®è¦è½¬åŒ–ä¸ºè¿ç»´æ´å¯Ÿ**
```
æ•°æ®ä»·å€¼æŒ–æ˜ï¼š
â€¢ è¶‹åŠ¿åˆ†æï¼šé¢„æµ‹å®¹é‡éœ€æ±‚
â€¢ æ¨¡å¼è¯†åˆ«ï¼šå‘ç°å¼‚å¸¸è¡Œä¸º
â€¢ æ€§èƒ½åŸºçº¿ï¼šå»ºç«‹å¥åº·æ ‡å‡†
â€¢ å…³è”åˆ†æï¼šæ‰¾å‡ºé—®é¢˜æ ¹å› 
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ç›‘æ§è„šæœ¬éƒ¨ç½²æ¸…å•**ï¼š
- âœ… **åŸºç¡€ç›‘æ§**ï¼šç£ç›˜ä½¿ç”¨ç‡ã€æœåŠ¡çŠ¶æ€
- âœ… **æ€§èƒ½ç›‘æ§**ï¼šI/Oç»Ÿè®¡ã€å»¶è¿Ÿæµ‹è¯•
- âœ… **å¥åº·æ£€æŸ¥**ï¼šç»„ä»¶çŠ¶æ€ã€ä¸€è‡´æ€§éªŒè¯
- âœ… **å‘Šè­¦é€šçŸ¥**ï¼šå¤šæ¸ é“ã€åˆ†çº§åˆ«
- âœ… **æ•°æ®æ”¶é›†**ï¼šå†å²è®°å½•ã€è¶‹åŠ¿åˆ†æ
- âœ… **å¯è§†åŒ–**ï¼šå›¾è¡¨å±•ç¤ºã€å®æ—¶ä»ªè¡¨æ¿

**è¿ç»´è‡ªåŠ¨åŒ–ç¨‹åº¦**ï¼š
- ğŸ¯ **è‡ªåŠ¨å‘ç°**ï¼šæ–°è®¾å¤‡ã€é…ç½®å˜æ›´
- ğŸ¯ **è‡ªåŠ¨å‘Šè­¦**ï¼šé˜ˆå€¼è§¦å‘ã€æ™ºèƒ½æŠ‘åˆ¶
- ğŸ¯ **è‡ªåŠ¨ä¿®å¤**ï¼šå¸¸è§é—®é¢˜ã€é¢„è®¾åŠ¨ä½œ
- ğŸ¯ **è‡ªåŠ¨æŠ¥å‘Š**ï¼šå®šæœŸæ±‡æ€»ã€è¶‹åŠ¿åˆ†æ

### 10.4 å¸¸è§é—®é¢˜è§£å†³


| é—®é¢˜ç±»å‹ | **ç°è±¡** | **ç›‘æ§æ–¹æ³•** | **è§£å†³æ€è·¯** |
|---------|---------|-------------|-------------|
| ğŸ”¸ **ç©ºé—´ä¸è¶³** | `ä½¿ç”¨ç‡>90%` | `å®æ—¶ç›‘æ§+é¢„æµ‹å‘Šè­¦` | `æ‰©å®¹æˆ–æ¸…ç†` |
| ğŸ”¸ **æ€§èƒ½ä¸‹é™** | `I/Oå»¶è¿Ÿå¢åŠ ` | `æ€§èƒ½åŸºå‡†+è¶‹åŠ¿åˆ†æ` | `è´Ÿè½½å‡è¡¡æˆ–ä¼˜åŒ–` |
| ğŸ”¸ **ç¡¬ä»¶æ•…éšœ** | `I/Oé”™è¯¯å¢åŠ ` | `é”™è¯¯è®¡æ•°+å¥åº·æ£€æŸ¥` | `æ›´æ¢ç¡¬ä»¶` |
| ğŸ”¸ **é…ç½®é”™è¯¯** | `æŒ‚è½½å¤±è´¥` | `çŠ¶æ€æ£€æŸ¥+é…ç½®éªŒè¯` | `ä¿®æ­£é…ç½®` |

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- LVMç›‘æ§è¦†ç›–å››ä¸ªå±‚æ¬¡ï¼šPVã€VGã€LVã€æ–‡ä»¶ç³»ç»Ÿ
- å‘Šè­¦è¦åˆ†çº§åˆ«ï¼šINFOã€WARNINGã€CRITICAL
- è‡ªåŠ¨åŒ–æ˜¯è¶‹åŠ¿ï¼šå‘ç°ã€å‘Šè­¦ã€ä¿®å¤ã€æŠ¥å‘Š
- æ•°æ®é©±åŠ¨å†³ç­–ï¼šåŸºäºç›‘æ§æ•°æ®ä¼˜åŒ–è¿ç»´ç­–ç•¥