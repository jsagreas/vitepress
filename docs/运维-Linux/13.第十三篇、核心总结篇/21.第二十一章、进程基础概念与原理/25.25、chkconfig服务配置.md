---
title: 25、chkconfig服务配置
---
## 📚 目录

1. [chkconfig基础概念](#1-chkconfig基础概念)
2. [运行级别详解](#2-运行级别详解)
3. [chkconfig命令用法](#3-chkconfig命令用法)
4. [服务自启动管理](#4-服务自启动管理)
5. [服务脚本要求与规范](#5-服务脚本要求与规范)
6. [实际应用场景](#6-实际应用场景)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔧 chkconfig基础概念


### 1.1 什么是chkconfig


**🔸 核心定义**
```
chkconfig：传统SysV初始化系统的服务管理工具
作用：管理系统服务在不同运行级别下的启停状态
位置：主要用于Red Hat系列Linux发行版（CentOS、RHEL等）
```

**💡 通俗理解**

想象你的电脑就像一栋大楼，不同的楼层代表不同的"工作模式"：
- 1楼：单用户维护模式（只有管理员能进）
- 3楼：多用户文本模式（大家都能用，但没有图形界面）
- 5楼：多用户图形模式（完整桌面环境）

`chkconfig`就像大楼的**服务管理员**，决定在每个楼层（运行级别）开启哪些服务。

### 1.2 SysV与现代systemd的区别


**🔄 发展历程对比**
```
传统SysV时代：                现代systemd时代：
┌─────────────┐               ┌─────────────┐
│  chkconfig  │────────────→  │  systemctl  │
│             │               │             │
│ 运行级别0-6 │               │ 多种target  │
│ 串行启动    │               │ 并行启动    │
│ shell脚本   │               │ unit文件    │
└─────────────┘               └─────────────┘
```

> ⚠️ **重要提醒**：现在大多数新系统都使用systemd，但了解chkconfig仍然很重要，因为很多老系统还在使用，而且理解传统方式有助于更好地掌握现代系统。

---

## 2. 📊 运行级别详解


### 2.1 Linux运行级别概念


**🎯 运行级别定义**

运行级别就是Linux系统的**工作模式**，每个级别决定了系统启动哪些服务。

```
Linux运行级别图示：

级别0：关机          [关闭所有服务] → 系统关闭
级别1：单用户模式    [最小服务] → 维护模式  
级别2：多用户无网络  [基本服务] → 本地多用户
级别3：多用户有网络  [网络服务] → 服务器模式
级别4：未使用        [自定义] → 用户自定义
级别5：图形界面      [全部服务] → 桌面模式
级别6：重启          [关闭再启动] → 系统重启
```

### 2.2 各运行级别详细说明


| 运行级别 | 名称 | 说明 | 典型用途 | 启动的服务 |
|---------|------|------|----------|------------|
| **0** | `halt` | 系统关机 | 正常关机 | 🔴 只有关机相关服务 |
| **1** | `single-user` | 单用户模式 | 系统维护、密码恢复 | 🟡 最基本的系统服务 |
| **2** | `multi-user` | 多用户无网络 | 本地调试 | 🟡 本地服务，不含网络 |
| **3** | `multi-user-net` | 多用户有网络 | **服务器标准模式** | 🟢 完整服务（无GUI） |
| **4** | `unused` | 用户自定义 | 特殊需求 | 🔵 用户自定义配置 |
| **5** | `graphical` | 图形界面 | **桌面用户模式** | 🟢 全部服务+图形界面 |
| **6** | `reboot` | 系统重启 | 重启系统 | 🔴 重启相关服务 |

**🔍 查看当前运行级别**
```bash
# 查看当前运行级别
runlevel
# 输出：N 3  (从无到运行级别3)

# 查看默认运行级别
cat /etc/inittab | grep initdefault
# 输出：id:3:initdefault:  (默认运行级别3)
```

---

## 3. 🛠️ chkconfig命令用法


### 3.1 基本命令格式


**📋 命令语法**
```bash
chkconfig [选项] [服务名] [on|off|reset]
chkconfig [选项] [服务名] --level [运行级别]
```

### 3.2 核心功能命令详解


#### 🔍 查询服务状态


**查看所有服务状态**
```bash
# 列出所有服务的启动状态
chkconfig --list

# 输出示例：
# NetworkManager  0:off  1:off  2:on   3:on   4:on   5:on   6:off
# crond           0:off  1:off  2:on   3:on   4:on   5:on   6:off
# sshd            0:off  1:off  2:on   3:on   4:on   5:on   6:off
```

**查看特定服务状态**
```bash
# 查看单个服务状态
chkconfig --list sshd
# 输出：sshd 0:off 1:off 2:on 3:on 4:on 5:on 6:off

# 检查服务是否在指定级别启用
chkconfig --list | grep sshd
```

#### ⚡ 服务启停控制


**全局开启/关闭服务**
```bash
# 在默认运行级别（2,3,4,5）开启服务
chkconfig sshd on

# 在默认运行级别关闭服务  
chkconfig sshd off

# 重置为服务脚本的默认设置
chkconfig sshd reset
```

**指定运行级别控制**
```bash
# 只在运行级别3和5开启sshd
chkconfig --level 35 sshd on

# 在运行级别3关闭，运行级别5开启
chkconfig --level 3 sshd off
chkconfig --level 5 sshd on

# 多级别同时设置
chkconfig --level 2345 httpd on
```

#### 🔧 服务添加与删除


**添加新服务到管理**
```bash
# 添加服务到chkconfig管理
chkconfig --add myservice

# 添加后查看状态
chkconfig --list myservice
```

**从管理中删除服务**
```bash
# 从chkconfig管理中移除服务
chkconfig --del myservice

# 注意：这不会删除服务文件，只是不再管理
```

### 3.3 实用命令示例


**🎯 常见操作场景**

**场景1：配置Web服务器**
```bash
# Web服务器通常在运行级别3和5工作
chkconfig --level 35 httpd on
chkconfig --level 35 mysqld on

# 确认配置
chkconfig --list | grep -E 'httpd|mysqld'
```

**场景2：安全配置**  
```bash
# 关闭不需要的服务以提高安全性
chkconfig bluetooth off
chkconfig cups off  # 如果不需要打印服务

# 保持重要服务开启
chkconfig sshd on
chkconfig iptables on
```

---

## 4. 🚀 服务自启动管理


### 4.1 自启动概念理解


**💡 什么是服务自启动**

服务自启动就是让某个程序在系统开机时**自动运行**，不需要手动启动。

```
系统启动流程：
开机 → BIOS → 内核加载 → init进程 → 运行级别 → 启动服务

传统方式：                  chkconfig方式：
手动启动每个服务  ────→     自动启动配置的服务
service httpd start        chkconfig httpd on
service mysqld start       chkconfig mysqld on
service sshd start         chkconfig sshd on
```

### 4.2 自启动设置实践


**🔸 基本设置方法**
```bash
# 1. 开启服务自启动（推荐级别2,3,4,5）
chkconfig httpd on

# 2. 验证设置结果
chkconfig --list httpd
# 应该看到：httpd 0:off 1:off 2:on 3:on 4:on 5:on 6:off

# 3. 立即启动服务（不等重启）
service httpd start
```

**🔍 自启动检查清单**
- [ ] 使用`chkconfig --list`确认服务已设置
- [ ] 使用`service 服务名 status`确认服务当前状态  
- [ ] 重启系统测试自启动是否生效
- [ ] 检查服务日志确认正常启动

### 4.3 批量管理技巧


**批量设置多个服务**
```bash
# 定义需要开启的服务列表
SERVICES="sshd crond network iptables"

# 批量开启
for service in $SERVICES; do
    chkconfig $service on
    echo "$service 已设置自启动"
done

# 批量检查状态
for service in $SERVICES; do
    chkconfig --list $service
done
```

---

## 5. 📝 服务脚本要求与规范


### 5.1 服务脚本基础要求


**📂 脚本位置与命名**
```
服务脚本位置：/etc/init.d/
命名规则：服务名（不含扩展名）
权限要求：755（可执行）

示例：
/etc/init.d/httpd      ← Apache服务脚本
/etc/init.d/mysqld     ← MySQL服务脚本
/etc/init.d/sshd       ← SSH服务脚本
```

### 5.2 脚本头部信息要求


**🔸 chkconfig配置行**

每个服务脚本必须包含特殊的注释行，告诉chkconfig如何管理这个服务：

```bash
#!/bin/bash
#
# myservice    这里是服务描述
#
# chkconfig: 35 80 20
# description: 这是一个示例服务的详细描述
#
```

**📋 配置行格式说明**
```
chkconfig: 35 80 20
           │  │  │
           │  │  └── 停止优先级（数字越小越先停止）
           │  └───── 启动优先级（数字越小越先启动）  
           └──────── 默认运行级别（这个服务在哪些级别下启动）
```

**💡 优先级理解**

优先级决定了服务启动和停止的**顺序**：

```
启动顺序（优先级从小到大）：
网络服务(10) → 数据库(50) → Web服务(80) → 应用服务(90)

停止顺序（优先级从小到大，但实际是倒序停止）：
应用服务先停(10) → Web服务(20) → 数据库(50) → 网络服务最后停(90)
```

### 5.3 标准服务脚本结构


**🏗️ 完整脚本示例**

```bash
#!/bin/bash
#
# myapp        My Application Service  
#
# chkconfig: 35 85 15
# description: This is my custom application service
#

# 服务名称
SERVICE_NAME="myapp"
# 程序路径
DAEMON="/usr/local/bin/myapp"
# 锁文件
LOCK_FILE="/var/lock/subsys/$SERVICE_NAME"

# 启动函数
start() {
    echo "Starting $SERVICE_NAME..."
    $DAEMON &
    touch $LOCK_FILE
}

# 停止函数  
stop() {
    echo "Stopping $SERVICE_NAME..."
    pkill -f $DAEMON
    rm -f $LOCK_FILE
}

# 状态检查
status() {
    if [ -f $LOCK_FILE ]; then
        echo "$SERVICE_NAME is running"
    else
        echo "$SERVICE_NAME is stopped"
    fi
}

# 主要逻辑
case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    status)
        status
        ;;
    restart)
        stop
        start
        ;;
    *)
        echo "Usage: $0 {start|stop|status|restart}"
        exit 1
esac
```

### 5.4 服务脚本安装流程


**🔧 安装新服务的完整步骤**

1. **创建服务脚本**
```bash
# 创建脚本文件
sudo vi /etc/init.d/myservice

# 设置执行权限
sudo chmod 755 /etc/init.d/myservice
```

2. **添加到chkconfig管理**
```bash
# 添加到chkconfig
sudo chkconfig --add myservice

# 验证添加成功
chkconfig --list myservice
```

3. **设置自启动**
```bash
# 设置在运行级别3,5自启动
sudo chkconfig --level 35 myservice on

# 立即启动服务测试
sudo service myservice start
```

---

## 6. 💼 实际应用场景


### 6.1 Web服务器环境配置


**🌐 LAMP环境自启动配置**

```bash
# 典型Web服务器需要的服务
echo "配置LAMP环境自启动..."

# Apache Web服务器
chkconfig --level 35 httpd on

# MySQL数据库  
chkconfig --level 35 mysqld on

# 网络服务（必需）
chkconfig --level 2345 network on

# SSH远程管理
chkconfig --level 2345 sshd on

# 防火墙
chkconfig --level 2345 iptables on

# 系统日志
chkconfig --level 2345 rsyslog on
```

> 💡 **实用技巧**：Web服务器通常不需要在单用户模式(1)下运行，所以主要配置级别3和5。

### 6.2 服务器安全配置


**🔒 安全导向的服务配置**

```bash
# 关闭不必要的服务以提高安全性
DISABLE_SERVICES="bluetooth cups avahi-daemon"

for service in $DISABLE_SERVICES; do
    if chkconfig --list | grep -q $service; then
        chkconfig $service off
        echo "已关闭 $service 服务"
    fi
done

# 保持关键安全服务
SECURITY_SERVICES="iptables sshd rsyslog crond"

for service in $SECURITY_SERVICES; do
    chkconfig --level 2345 $service on
    echo "已启用 $service 服务"
done
```

### 6.3 开发环境快速部署


**⚡ 开发服务器一键配置**

```bash
#!/bin/bash
# 开发环境服务配置脚本

echo "=== 开发环境服务配置 ==="

# 基础服务
chkconfig --level 35 network on
chkconfig --level 35 sshd on
chkconfig --level 35 crond on

# 开发工具服务
chkconfig --level 5 httpd on      # Web服务器
chkconfig --level 5 mysqld on     # 数据库
chkconfig --level 5 redis on      # 缓存服务

# 关闭不需要的服务
chkconfig postfix off             # 邮件服务
chkconfig bluetooth off           # 蓝牙服务

echo "开发环境配置完成！"
echo "请运行以下命令重启系统验证："
echo "sudo reboot"
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 chkconfig本质：传统SysV系统的服务管理工具
🔸 运行级别：系统工作模式，决定启动哪些服务
🔸 自启动设置：让服务在开机时自动启动
🔸 服务优先级：控制服务启停的先后顺序
🔸 脚本规范：服务脚本必须符合特定格式要求
```

### 7.2 关键理解要点


**🔹 运行级别的实际意义**
```
级别0,6：系统关闭和重启，特殊用途
级别1：   单用户维护模式，类似安全模式
级别3：   服务器标准模式，命令行界面
级别5：   桌面用户模式，图形界面
```

**🔹 chkconfig vs service命令**
```
chkconfig：管理服务的自启动设置（开机是否启动）
service：  控制服务的当前状态（立即启停）

配合使用：
chkconfig httpd on    # 设置开机自启
service httpd start   # 立即启动服务
```

**🔹 服务优先级的重要性**
```
正确的启动顺序很重要：
网络 → 数据库 → Web服务 → 应用
如果顺序错误，依赖的服务可能无法正常启动
```

### 7.3 实用操作指南


**✅ 日常管理检查清单**
- [ ] 定期检查`chkconfig --list`了解服务状态
- [ ] 新安装服务后记得设置自启动  
- [ ] 关闭不需要的服务提高安全性
- [ ] 重要变更后重启测试验证

**⚠️ 常见注意事项**
```
安全原则：
• 只启用必需的服务，关闭不用的服务
• 重要服务设置多运行级别备份
• 定期审查服务列表，清理无用服务

故障排除：  
• 服务无法自启动：检查脚本格式和权限
• 启动顺序问题：调整优先级数字
• 脚本报错：查看/var/log/messages日志
```

### 7.4 现代系统迁移建议


**🔄 从chkconfig迁移到systemd**

```
传统命令              现代替代命令
chkconfig --list      systemctl list-unit-files
chkconfig sshd on     systemctl enable sshd
chkconfig sshd off    systemctl disable sshd
service sshd start    systemctl start sshd
service sshd status   systemctl status sshd
```

> 📚 **学习建议**：虽然现代系统多使用systemd，但掌握chkconfig有助于：
> - 维护老旧系统
> - 理解Linux服务管理演进历程  
> - 更好地理解systemd的设计思想

### 7.5 实践记忆要点


**🧠 核心记忆公式**
```
chkconfig = 运行级别 + 服务管理 + 自启动控制

关键级别：3(服务器) + 5(桌面)
重要命令：--list(查看) + on/off(开关) + --level(指定级别)
脚本要求：权限755 + chkconfig注释行 + 标准函数
```

**🎯 一句话总结**
chkconfig是传统Linux系统中管理服务自启动的核心工具，通过运行级别和优先级控制系统服务的启动行为，虽然现代系统多用systemd，但理解chkconfig对运维和系统管理仍然很有价值。