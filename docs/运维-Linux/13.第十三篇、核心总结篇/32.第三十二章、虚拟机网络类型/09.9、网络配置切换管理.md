---
title: 9ã€ç½‘ç»œé…ç½®åˆ‡æ¢ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ç½‘ç»œé…ç½®åˆ‡æ¢ç®¡ç†æ¦‚è¿°](#1-ç½‘ç»œé…ç½®åˆ‡æ¢ç®¡ç†æ¦‚è¿°)
2. [ç½‘ç»œç±»å‹åŠ¨æ€åˆ‡æ¢](#2-ç½‘ç»œç±»å‹åŠ¨æ€åˆ‡æ¢)
3. [é…ç½®æ–‡ä»¶å¤‡ä»½ä¸ç‰ˆæœ¬ç®¡ç†](#3-é…ç½®æ–‡ä»¶å¤‡ä»½ä¸ç‰ˆæœ¬ç®¡ç†)
4. [è‡ªåŠ¨é…ç½®è„šæœ¬å¼€å‘](#4-è‡ªåŠ¨é…ç½®è„šæœ¬å¼€å‘)
5. [æ‰¹é‡ç½‘ç»œé…ç½®ç®¡ç†](#5-æ‰¹é‡ç½‘ç»œé…ç½®ç®¡ç†)
6. [é…ç½®éªŒè¯ä¸å›æ»šæœºåˆ¶](#6-é…ç½®éªŒè¯ä¸å›æ»šæœºåˆ¶)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ç½‘ç»œé…ç½®åˆ‡æ¢ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç½‘ç»œé…ç½®åˆ‡æ¢ç®¡ç†


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šç½‘ç»œé…ç½®åˆ‡æ¢ç®¡ç†æ˜¯æŒ‡åœ¨Linuxç³»ç»Ÿä¸­åŠ¨æ€è°ƒæ•´ç½‘ç»œè®¾ç½®çš„ä¸€å¥—å®Œæ•´æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ä¸åŒç½‘ç»œç¯å¢ƒé—´çš„å¿«é€Ÿåˆ‡æ¢ã€é…ç½®ä¿å­˜ä¸æ¢å¤ã€ä»¥åŠè‡ªåŠ¨åŒ–ç®¡ç†ç­‰åŠŸèƒ½ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒæˆ‘ä»¬åœ¨æ‰‹æœºä¸Šåˆ‡æ¢WiFiç½‘ç»œä¸€æ ·ï¼ŒLinuxç³»ç»Ÿä¹Ÿéœ€è¦åœ¨ä¸åŒçš„ç½‘ç»œç¯å¢ƒä¸­å¿«é€Ÿåˆ‡æ¢é…ç½®ï¼Œæ¯”å¦‚ä»å…¬å¸ç½‘ç»œåˆ‡æ¢åˆ°å®¶åº­ç½‘ç»œã€‚

**åº”ç”¨åœºæ™¯**ï¼š
- ç¬”è®°æœ¬ç”µè„‘åœ¨ä¸åŒåŠå…¬åœºæ‰€ä½¿ç”¨
- æœåŠ¡å™¨åœ¨ä¸åŒæ•°æ®ä¸­å¿ƒéƒ¨ç½²
- å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒé…ç½®åˆ‡æ¢
- ç½‘ç»œæ•…éšœæ—¶çš„å¿«é€Ÿæ¢å¤

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®åˆ‡æ¢ç®¡ç†


**ä¼ ç»Ÿé—®é¢˜**ï¼š
```
æ‰‹åŠ¨ä¿®æ”¹é…ç½® â†’ å®¹æ˜“å‡ºé”™ â†’ å½±å“ä¸šåŠ¡
é…ç½®ä¸¢å¤±    â†’ éš¾ä»¥æ¢å¤ â†’ é‡æ–°è®¾ç½®
ç¯å¢ƒå˜åŒ–    â†’ é‡å¤å·¥ä½œ â†’ æ•ˆç‡ä½ä¸‹
```

**ç®¡ç†ä¼˜åŠ¿**ï¼š
- âš¡ **å¿«é€Ÿåˆ‡æ¢**ï¼šä¸€é”®åˆ‡æ¢ä¸åŒç½‘ç»œç¯å¢ƒ
- ğŸ›¡ï¸ **å®‰å…¨å¤‡ä»½**ï¼šé…ç½®æ–‡ä»¶è‡ªåŠ¨å¤‡ä»½ä¿æŠ¤
- ğŸ”„ **ç‰ˆæœ¬æ§åˆ¶**ï¼šè®°å½•é…ç½®å˜æ›´å†å²
- ğŸš€ **è‡ªåŠ¨åŒ–**ï¼šå‡å°‘äººå·¥æ“ä½œé”™è¯¯

---

## 2. ğŸ”„ ç½‘ç»œç±»å‹åŠ¨æ€åˆ‡æ¢


### 2.1 Linuxç½‘ç»œé…ç½®æ–‡ä»¶ä½“ç³»


**é…ç½®æ–‡ä»¶ç»“æ„**ï¼š
```
/etc/network/        â† Debian/Ubuntuç³»ç»Ÿ
â”œâ”€â”€ interfaces       â† ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ interfaces.d/    â† æ¨¡å—åŒ–é…ç½®ç›®å½•
â””â”€â”€ if-up.d/        â† ç½‘å¡å¯åŠ¨è„šæœ¬

/etc/sysconfig/network-scripts/  â† RedHat/CentOSç³»ç»Ÿ
â”œâ”€â”€ ifcfg-eth0      â† ç½‘å¡é…ç½®æ–‡ä»¶
â”œâ”€â”€ route-eth0      â† è·¯ç”±é…ç½®
â””â”€â”€ resolv.conf     â† DNSé…ç½®
```

> ğŸ“– **çŸ¥è¯†ç‚¹**ï¼šä¸åŒLinuxå‘è¡Œç‰ˆä½¿ç”¨ä¸åŒçš„ç½‘ç»œç®¡ç†æ–¹å¼ï¼Œä½†æ ¸å¿ƒæ€æƒ³ç›¸åŒï¼šé€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰ç½‘ç»œå‚æ•°ã€‚

### 2.2 å¸¸è§ç½‘ç»œç±»å‹é…ç½®


**é™æ€IPé…ç½®**ï¼š
```bash
# /etc/network/interfaces (Ubuntu)
auto eth0
iface eth0 inet static
    address 192.168.1.100
    netmask 255.255.255.0
    gateway 192.168.1.1
    dns-nameservers 8.8.8.8 8.8.4.4
```

**DHCPåŠ¨æ€é…ç½®**ï¼š
```bash
# è‡ªåŠ¨è·å–IPåœ°å€
auto eth0
iface eth0 inet dhcp
```

> âš ï¸ **æ³¨æ„**ï¼šä¿®æ”¹ç½‘ç»œé…ç½®åéœ€è¦é‡å¯ç½‘ç»œæœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼Œæ“ä½œå‰ç¡®ä¿æœ‰å…¶ä»–è®¿é—®æ–¹å¼ã€‚

### 2.3 ç½‘ç»œç±»å‹åˆ‡æ¢å®ç°


**åˆ‡æ¢åŸç†å›¾**ï¼š
```
å½“å‰é…ç½® â”€â”€â”
           â”‚
           â–¼
    [å¤‡ä»½åŸé…ç½®]
           â”‚
           â–¼
    [åŠ è½½æ–°é…ç½®]
           â”‚
           â–¼
    [é‡å¯ç½‘ç»œæœåŠ¡]
           â”‚
           â–¼
    [éªŒè¯è¿æ¥çŠ¶æ€]
```

**åŸºç¡€åˆ‡æ¢è„šæœ¬**ï¼š
```bash
#!/bin/bash
# network_switch.sh - ç½‘ç»œé…ç½®åˆ‡æ¢è„šæœ¬

switch_network() {
    local config_type=$1
    local interface=${2:-eth0}
    
    echo "ğŸ”„ åˆ‡æ¢åˆ° $config_type é…ç½®..."
    
    # å¤‡ä»½å½“å‰é…ç½®
    cp /etc/network/interfaces /etc/network/interfaces.backup.$(date +%Y%m%d_%H%M%S)
    
    # æ ¹æ®ç±»å‹åˆ‡æ¢
    case $config_type in
        "static")
            apply_static_config $interface
            ;;
        "dhcp")
            apply_dhcp_config $interface
            ;;
        *)
            echo "âŒ ä¸æ”¯æŒçš„é…ç½®ç±»å‹: $config_type"
            return 1
            ;;
    esac
    
    # é‡å¯ç½‘ç»œ
    systemctl restart networking
    
    # éªŒè¯è¿æ¥
    if ping -c 1 8.8.8.8 > /dev/null 2>&1; then
        echo "âœ… ç½‘ç»œåˆ‡æ¢æˆåŠŸ!"
    else
        echo "âŒ ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®"
    fi
}
```

---

## 3. ğŸ’¾ é…ç½®æ–‡ä»¶å¤‡ä»½ä¸ç‰ˆæœ¬ç®¡ç†


### 3.1 é…ç½®å¤‡ä»½ç­–ç•¥


**å¤‡ä»½å±‚æ¬¡ç»“æ„**ï¼š
```
/etc/network-backups/
â”œâ”€â”€ daily/          â† æ—¥å¸¸è‡ªåŠ¨å¤‡ä»½
â”œâ”€â”€ manual/         â† æ‰‹åŠ¨å¤‡ä»½
â”œâ”€â”€ versions/       â† ç‰ˆæœ¬åŒ–å¤‡ä»½
â””â”€â”€ rollback/       â† å›æ»šå¤‡ä»½
```

> ğŸ”§ **å®è·µå»ºè®®**ï¼šå»ºç«‹å¤šå±‚æ¬¡å¤‡ä»½æœºåˆ¶ï¼Œç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æ¢å¤ç½‘ç»œé…ç½®ã€‚

### 3.2 è‡ªåŠ¨å¤‡ä»½å®ç°


**å¤‡ä»½è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# backup_network_config.sh

BACKUP_DIR="/etc/network-backups"
DATE_STAMP=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR/{daily,manual,versions,rollback}

# å¤‡ä»½ä¸»è¦é…ç½®æ–‡ä»¶
backup_configs() {
    local backup_type=$1
    local target_dir="$BACKUP_DIR/$backup_type"
    
    echo "ğŸ“¦ åˆ›å»º $backup_type å¤‡ä»½..."
    
    # å¤‡ä»½ç½‘ç»œé…ç½®
    cp /etc/network/interfaces "$target_dir/interfaces_$DATE_STAMP"
    
    # å¤‡ä»½DNSé…ç½®
    cp /etc/resolv.conf "$target_dir/resolv.conf_$DATE_STAMP"
    
    # å¤‡ä»½ä¸»æœºåé…ç½®
    cp /etc/hostname "$target_dir/hostname_$DATE_STAMP"
    
    echo "âœ… å¤‡ä»½å®Œæˆ: $target_dir"
}

# æ¸…ç†æ—§å¤‡ä»½
cleanup_old_backups() {
    # ä¿ç•™æœ€è¿‘7å¤©çš„æ—¥å¸¸å¤‡ä»½
    find $BACKUP_DIR/daily -name "*" -mtime +7 -delete
    
    # ä¿ç•™æœ€è¿‘30ä¸ªæ‰‹åŠ¨å¤‡ä»½
    ls -t $BACKUP_DIR/manual | tail -n +31 | xargs -r rm
}
```

### 3.3 ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ


**é…ç½®ç‰ˆæœ¬è¿½è¸ª**ï¼š
```bash
# ä½¿ç”¨Gitç®¡ç†é…ç½®ç‰ˆæœ¬
init_config_git() {
    cd /etc
    git init network-configs
    cd network-configs
    
    # é“¾æ¥é…ç½®æ–‡ä»¶
    ln -s ../network/interfaces .
    ln -s ../resolv.conf .
    ln -s ../hostname .
    
    git add .
    git commit -m "Initial network configuration"
}

# æäº¤é…ç½®å˜æ›´
commit_config_change() {
    local message=$1
    cd /etc/network-configs
    
    git add -A
    git commit -m "$message - $(date '+%Y-%m-%d %H:%M:%S')"
    
    echo "ğŸ“ é…ç½®å˜æ›´å·²è®°å½•: $message"
}
```

> ğŸ“Š **ç‰ˆæœ¬ç®¡ç†å¥½å¤„**ï¼š
> - **å˜æ›´è¿½è¸ª**ï¼šè®°å½•æ¯æ¬¡ä¿®æ”¹çš„è¯¦ç»†ä¿¡æ¯
> - **å¿«é€Ÿå›æ»š**ï¼šä¸€é”®æ¢å¤åˆ°ä»»æ„å†å²ç‰ˆæœ¬
> - **å›¢é˜Ÿåä½œ**ï¼šå¤šäººç»´æŠ¤æ—¶é¿å…é…ç½®å†²çª

---

## 4. âš™ï¸ è‡ªåŠ¨é…ç½®è„šæœ¬å¼€å‘


### 4.1 æ™ºèƒ½é…ç½®æ£€æµ‹


**ç½‘ç»œç¯å¢ƒè‡ªåŠ¨è¯†åˆ«**ï¼š
```bash
#!/bin/bash
# auto_network_config.sh

detect_network_environment() {
    echo "ğŸ” æ£€æµ‹ç½‘ç»œç¯å¢ƒ..."
    
    # æ£€æµ‹å¯ç”¨ç½‘ç»œæ¥å£
    local interfaces=$(ip link show | grep -E "^[0-9]" | cut -d: -f2 | tr -d ' ')
    
    # æ£€æµ‹ç½‘å…³å¯è¾¾æ€§
    local gateways=$(ip route | grep default | awk '{print $3}')
    
    # æ£€æµ‹DNSè§£æ
    local dns_status=$(nslookup google.com > /dev/null 2>&1 && echo "OK" || echo "FAIL")
    
    echo "ğŸ“Š ç½‘ç»œç¯å¢ƒæŠ¥å‘Šï¼š"
    echo "   æ¥å£: $interfaces"
    echo "   ç½‘å…³: $gateways"
    echo "   DNS: $dns_status"
}

# æ™ºèƒ½é…ç½®æ¨è
recommend_config() {
    local network_segment=$(ip route | grep -E "192\.168\.|10\.|172\." | head -1 | cut -d' ' -f1)
    
    if [[ $network_segment =~ "192.168.1" ]]; then
        echo "ğŸ  æ£€æµ‹åˆ°å®¶åº­ç½‘ç»œç¯å¢ƒ"
        suggest_home_config
    elif [[ $network_segment =~ "192.168.0" ]]; then
        echo "ğŸ¢ æ£€æµ‹åˆ°åŠå…¬ç½‘ç»œç¯å¢ƒ"  
        suggest_office_config
    else
        echo "ğŸŒ æ£€æµ‹åˆ°å…¶ä»–ç½‘ç»œç¯å¢ƒ"
        suggest_generic_config
    fi
}
```

### 4.2 é…ç½®æ¨¡æ¿ç®¡ç†


**é¢„å®šä¹‰é…ç½®æ¨¡æ¿**ï¼š
```
/etc/network-templates/
â”œâ”€â”€ home.conf           â† å®¶åº­ç½‘ç»œæ¨¡æ¿
â”œâ”€â”€ office.conf         â† åŠå…¬ç½‘ç»œæ¨¡æ¿
â”œâ”€â”€ mobile.conf         â† ç§»åŠ¨çƒ­ç‚¹æ¨¡æ¿
â””â”€â”€ server.conf         â† æœåŠ¡å™¨ç¯å¢ƒæ¨¡æ¿
```

**æ¨¡æ¿åº”ç”¨è„šæœ¬**ï¼š
```bash
apply_template() {
    local template_name=$1
    local template_file="/etc/network-templates/$template_name.conf"
    
    if [ ! -f "$template_file" ]; then
        echo "âŒ æ¨¡æ¿ä¸å­˜åœ¨: $template_name"
        return 1
    fi
    
    echo "ğŸ“‹ åº”ç”¨é…ç½®æ¨¡æ¿: $template_name"
    
    # å¤‡ä»½å½“å‰é…ç½®
    backup_current_config
    
    # åº”ç”¨æ¨¡æ¿
    cp "$template_file" /etc/network/interfaces
    
    # é‡å¯ç½‘ç»œæœåŠ¡
    systemctl restart networking
    
    echo "âœ… æ¨¡æ¿åº”ç”¨å®Œæˆ"
}
```

### 4.3 å‚æ•°åŒ–é…ç½®ç”Ÿæˆ


**åŠ¨æ€é…ç½®ç”Ÿæˆ**ï¼š
```bash
generate_static_config() {
    local ip_address=$1
    local netmask=$2
    local gateway=$3
    local dns1=${4:-8.8.8.8}
    local dns2=${5:-8.8.4.4}
    local interface=${6:-eth0}
    
    cat > /etc/network/interfaces << EOF
# è‡ªåŠ¨ç”Ÿæˆçš„é™æ€IPé…ç½®
# ç”Ÿæˆæ—¶é—´: $(date)

auto lo
iface lo inet loopback

auto $interface
iface $interface inet static
    address $ip_address
    netmask $netmask
    gateway $gateway
    dns-nameservers $dns1 $dns2
EOF
    
    echo "ğŸ“ é™æ€IPé…ç½®å·²ç”Ÿæˆ"
    echo "   IP: $ip_address"
    echo "   ç½‘å…³: $gateway"
    echo "   DNS: $dns1, $dns2"
}
```

---

## 5. ğŸš€ æ‰¹é‡ç½‘ç»œé…ç½®ç®¡ç†


### 5.1 å¤šä¸»æœºé…ç½®åŒæ­¥


**æ‰¹é‡éƒ¨ç½²æ¶æ„**ï¼š
```
ç®¡ç†ä¸»æœº â”€â”€â”€â”€â”€â”€â”
             â”‚
             â”œâ”€â†’ ç›®æ ‡ä¸»æœº1
             â”œâ”€â†’ ç›®æ ‡ä¸»æœº2
             â”œâ”€â†’ ç›®æ ‡ä¸»æœº3
             â””â”€â†’ ç›®æ ‡ä¸»æœºN
```

> ğŸ’¡ **åº”ç”¨åœºæ™¯**ï¼šæ•°æ®ä¸­å¿ƒæ‰¹é‡æœåŠ¡å™¨é…ç½®ã€å®¹å™¨é›†ç¾¤ç½‘ç»œè®¾ç½®ã€å®éªŒå®¤ç¯å¢ƒç»Ÿä¸€ç®¡ç†ã€‚

### 5.2 SSHæ‰¹é‡é…ç½®è„šæœ¬


**ä¸»æœºåˆ—è¡¨ç®¡ç†**ï¼š
```bash
# hosts.conf - ä¸»æœºé…ç½®æ–‡ä»¶
# æ ¼å¼: IPåœ°å€:ç”¨æˆ·å:å¯†ç :é…ç½®ç±»å‹
192.168.1.10:root:password123:static
192.168.1.11:root:password123:dhcp
192.168.1.12:root:password123:static
```

**æ‰¹é‡é…ç½®æ‰§è¡Œ**ï¼š
```bash
#!/bin/bash
# batch_network_config.sh

batch_configure() {
    local hosts_file="hosts.conf"
    local failed_hosts=()
    
    echo "ğŸš€ å¼€å§‹æ‰¹é‡ç½‘ç»œé…ç½®..."
    
    while IFS=':' read -r host user pass config_type; do
        # è·³è¿‡æ³¨é‡Šè¡Œ
        [[ $host =~ ^#.*$ ]] && continue
        
        echo "ğŸ“¡ é…ç½®ä¸»æœº: $host"
        
        if configure_remote_host "$host" "$user" "$pass" "$config_type"; then
            echo "âœ… $host é…ç½®æˆåŠŸ"
        else
            echo "âŒ $host é…ç½®å¤±è´¥"
            failed_hosts+=("$host")
        fi
        
        sleep 2  # é¿å…å¹¶å‘è¿‡å¤š
        
    done < "$hosts_file"
    
    # æŠ¥å‘Šç»“æœ
    if [ ${#failed_hosts[@]} -eq 0 ]; then
        echo "ğŸ‰ æ‰€æœ‰ä¸»æœºé…ç½®å®Œæˆ!"
    else
        echo "âš ï¸  å¤±è´¥ä¸»æœº: ${failed_hosts[*]}"
    fi
}

configure_remote_host() {
    local host=$1 user=$2 pass=$3 config_type=$4
    
    # ä½¿ç”¨sshpassè¿›è¡Œæ— äº¤äº’SSHè¿æ¥
    sshpass -p "$pass" ssh -o StrictHostKeyChecking=no "$user@$host" << EOF
        # åœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œé…ç½®
        /opt/scripts/network_switch.sh $config_type
        systemctl restart networking
        ping -c 1 8.8.8.8 > /dev/null 2>&1
EOF
}
```

### 5.3 é…ç½®ä¸€è‡´æ€§æ£€æŸ¥


**ä¸€è‡´æ€§éªŒè¯è„šæœ¬**ï¼š
```bash
check_network_consistency() {
    local reference_host=$1
    local check_hosts=("${@:2}")
    
    echo "ğŸ” ç½‘ç»œé…ç½®ä¸€è‡´æ€§æ£€æŸ¥..."
    echo "å‚è€ƒä¸»æœº: $reference_host"
    
    # è·å–å‚è€ƒé…ç½®
    local ref_config=$(ssh root@$reference_host "md5sum /etc/network/interfaces")
    local ref_md5=$(echo $ref_config | cut -d' ' -f1)
    
    # æ£€æŸ¥å…¶ä»–ä¸»æœº
    for host in "${check_hosts[@]}"; do
        local host_config=$(ssh root@$host "md5sum /etc/network/interfaces" 2>/dev/null)
        local host_md5=$(echo $host_config | cut -d' ' -f1)
        
        if [ "$ref_md5" = "$host_md5" ]; then
            echo "âœ… $host: é…ç½®ä¸€è‡´"
        else
            echo "âŒ $host: é…ç½®ä¸ä¸€è‡´"
        fi
    done
}
```

---

## 6. ğŸ›¡ï¸ é…ç½®éªŒè¯ä¸å›æ»šæœºåˆ¶


### 6.1 ç½‘ç»œè¿é€šæ€§éªŒè¯


**å¤šå±‚æ¬¡éªŒè¯ä½“ç³»**ï¼š
```
åŸºç¡€è¿æ¥éªŒè¯
      â†“
ç½‘å…³å¯è¾¾æ€§æµ‹è¯•
      â†“
DNSè§£æéªŒè¯
      â†“
å¤–ç½‘è¿é€šæµ‹è¯•
      â†“
æœåŠ¡å¯ç”¨æ€§æ£€æŸ¥
```

### 6.2 è‡ªåŠ¨éªŒè¯è„šæœ¬


```bash
#!/bin/bash
# network_validation.sh

validate_network_config() {
    local validation_passed=true
    local test_results=()
    
    echo "ğŸ” å¼€å§‹ç½‘ç»œé…ç½®éªŒè¯..."
    
    # æµ‹è¯•1: ç½‘å¡çŠ¶æ€
    if ip link show | grep -q "state UP"; then
        test_results+=("âœ… ç½‘å¡çŠ¶æ€: æ­£å¸¸")
    else
        test_results+=("âŒ ç½‘å¡çŠ¶æ€: å¼‚å¸¸")
        validation_passed=false
    fi
    
    # æµ‹è¯•2: IPåœ°å€åˆ†é…
    local ip_address=$(ip addr show | grep -E "inet [0-9]" | head -1 | awk '{print $2}')
    if [ -n "$ip_address" ]; then
        test_results+=("âœ… IPåœ°å€: $ip_address")
    else
        test_results+=("âŒ IPåœ°å€: æœªåˆ†é…")
        validation_passed=false
    fi
    
    # æµ‹è¯•3: ç½‘å…³å¯è¾¾
    local gateway=$(ip route | grep default | awk '{print $3}' | head -1)
    if [ -n "$gateway" ] && ping -c 1 -W 3 "$gateway" > /dev/null 2>&1; then
        test_results+=("âœ… ç½‘å…³è¿æ¥: $gateway å¯è¾¾")
    else
        test_results+=("âŒ ç½‘å…³è¿æ¥: ä¸å¯è¾¾")
        validation_passed=false
    fi
    
    # æµ‹è¯•4: DNSè§£æ
    if nslookup google.com > /dev/null 2>&1; then
        test_results+=("âœ… DNSè§£æ: æ­£å¸¸")
    else
        test_results+=("âŒ DNSè§£æ: å¤±è´¥")
        validation_passed=false
    fi
    
    # æµ‹è¯•5: å¤–ç½‘è¿æ¥
    if curl -s --connect-timeout 5 http://www.google.com > /dev/null; then
        test_results+=("âœ… å¤–ç½‘è¿æ¥: æ­£å¸¸")
    else
        test_results+=("âŒ å¤–ç½‘è¿æ¥: å¤±è´¥")
        validation_passed=false
    fi
    
    # è¾“å‡ºæµ‹è¯•ç»“æœ
    echo "ğŸ“Š éªŒè¯ç»“æœæŠ¥å‘Š:"
    printf '%s\n' "${test_results[@]}"
    
    if $validation_passed; then
        echo "ğŸ‰ ç½‘ç»œé…ç½®éªŒè¯é€šè¿‡!"
        return 0
    else
        echo "âš ï¸  ç½‘ç»œé…ç½®éªŒè¯å¤±è´¥!"
        return 1
    fi
}
```

### 6.3 æ™ºèƒ½å›æ»šæœºåˆ¶


**å›æ»šå†³ç­–æµç¨‹**ï¼š
```
é…ç½®å˜æ›´
    â†“
éªŒè¯æµ‹è¯• â”€â†’ é€šè¿‡ â”€â†’ ä¿å­˜é…ç½®
    â†“
   å¤±è´¥
    â†“
è‡ªåŠ¨å›æ»š â”€â†’ æ¢å¤åŸé…ç½®
    â†“
å†æ¬¡éªŒè¯ â”€â†’ é€šè¿‡ â”€â†’ è®°å½•æ—¥å¿—
```

**å›æ»šå®ç°è„šæœ¬**ï¼š
```bash
#!/bin/bash
# smart_rollback.sh

implement_smart_rollback() {
    local config_change_description=$1
    local validation_timeout=${2:-30}
    
    echo "ğŸ”„ å¼€å§‹æ™ºèƒ½é…ç½®å˜æ›´..."
    
    # 1. åˆ›å»ºå›æ»šç‚¹
    create_rollback_point "$config_change_description"
    
    # 2. åº”ç”¨æ–°é…ç½®
    echo "ğŸ“ åº”ç”¨æ–°é…ç½®..."
    # (è¿™é‡Œæ˜¯å®é™…çš„é…ç½®å˜æ›´ä»£ç )
    
    # 3. éªŒè¯æ–°é…ç½®
    echo "â³ éªŒè¯é…ç½® (è¶…æ—¶: ${validation_timeout}s)..."
    
    if timeout $validation_timeout validate_network_config; then
        echo "âœ… é…ç½®å˜æ›´æˆåŠŸ!"
        commit_configuration "$config_change_description"
    else
        echo "âŒ é…ç½®éªŒè¯å¤±è´¥ï¼Œæ‰§è¡Œè‡ªåŠ¨å›æ»š..."
        perform_automatic_rollback
        
        # éªŒè¯å›æ»šç»“æœ
        if validate_network_config; then
            echo "âœ… è‡ªåŠ¨å›æ»šæˆåŠŸï¼Œç³»ç»Ÿå·²æ¢å¤"
        else
            echo "ğŸš¨ ä¸¥é‡é”™è¯¯ï¼šå›æ»šå¤±è´¥ï¼Œéœ€è¦äººå·¥å¹²é¢„!"
            send_alert_notification
        fi
    fi
}

create_rollback_point() {
    local description=$1
    local timestamp=$(date +%Y%m%d_%H%M%S)
    local rollback_dir="/etc/network-backups/rollback"
    
    mkdir -p "$rollback_dir"
    
    # ä¿å­˜å½“å‰é…ç½®å¿«ç…§
    cp /etc/network/interfaces "$rollback_dir/interfaces_$timestamp"
    cp /etc/resolv.conf "$rollback_dir/resolv_$timestamp"
    
    # è®°å½•å›æ»šä¿¡æ¯
    cat > "$rollback_dir/rollback_info_$timestamp" << EOF
æè¿°: $description
æ—¶é—´: $(date)
ç”¨æˆ·: $(whoami)
ç³»ç»Ÿ: $(uname -a)
EOF
    
    # è®¾ç½®å½“å‰å›æ»šç‚¹
    ln -sf "interfaces_$timestamp" "$rollback_dir/current_rollback"
    
    echo "ğŸ’¾ å›æ»šç‚¹å·²åˆ›å»º: $timestamp"
}

perform_automatic_rollback() {
    local rollback_dir="/etc/network-backups/rollback"
    local rollback_file="$rollback_dir/current_rollback"
    
    if [ -L "$rollback_file" ] && [ -f "$rollback_file" ]; then
        echo "ğŸ”™ æ‰§è¡Œè‡ªåŠ¨å›æ»š..."
        
        # æ¢å¤é…ç½®æ–‡ä»¶
        cp "$rollback_file" /etc/network/interfaces
        
        # é‡å¯ç½‘ç»œæœåŠ¡
        systemctl restart networking
        
        echo "âœ… å›æ»šæ“ä½œå®Œæˆ"
    else
        echo "âŒ å›æ»šæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œè‡ªåŠ¨å›æ»š"
        return 1
    fi
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç½‘ç»œé…ç½®åˆ‡æ¢ï¼šåœ¨ä¸åŒç½‘ç»œç¯å¢ƒé—´å¿«é€Ÿåˆ‡æ¢é…ç½®çš„èƒ½åŠ›
ğŸ”¸ é…ç½®å¤‡ä»½ç®¡ç†ï¼šä¿æŠ¤ç½‘ç»œé…ç½®å…äºæ„å¤–ä¸¢å¤±çš„æœºåˆ¶
ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼šè¿½è¸ªé…ç½®å˜æ›´å†å²ï¼Œæ”¯æŒå¿«é€Ÿå›æ»š
ğŸ”¸ è‡ªåŠ¨åŒ–è„šæœ¬ï¼šå‡å°‘äººå·¥æ“ä½œï¼Œæé«˜é…ç½®æ•ˆç‡å’Œå‡†ç¡®æ€§
ğŸ”¸ æ‰¹é‡ç®¡ç†ï¼šåŒæ—¶ç®¡ç†å¤šå°ä¸»æœºçš„ç½‘ç»œé…ç½®
ğŸ”¸ éªŒè¯å›æ»šæœºåˆ¶ï¼šç¡®ä¿é…ç½®å˜æ›´çš„å®‰å…¨æ€§å’Œå¯é æ€§
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é…ç½®ç®¡ç†çš„ä»·å€¼**
- **æ•ˆç‡æå‡**ï¼šä¸€æ¬¡é…ç½®ï¼Œå¤šæ¬¡ä½¿ç”¨
- **é£é™©é™ä½**ï¼šè‡ªåŠ¨å¤‡ä»½ï¼Œå¿«é€Ÿæ¢å¤
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€é…ç½®æ ‡å‡†ï¼Œå‡å°‘å·®å¼‚
- **å¯è¿½æº¯æ€§**ï¼šå®Œæ•´çš„å˜æ›´è®°å½•å’Œå†å²

**ğŸ”¹ å®æ–½ç­–ç•¥å»ºè®®**
```
å¾ªåºæ¸è¿›ï¼š
    æ‰‹åŠ¨æ“ä½œ â†’ è„šæœ¬åŒ– â†’ è‡ªåŠ¨åŒ– â†’ æ™ºèƒ½åŒ–

å®‰å…¨ä¼˜å…ˆï¼š
    å¤‡ä»½å…ˆè¡Œ â†’ æµ‹è¯•éªŒè¯ â†’ é€æ­¥æ¨è¿›

æ ‡å‡†è§„èŒƒï¼š
    é…ç½®æ¨¡æ¿ â†’ æ“ä½œæµç¨‹ â†’ æ–‡æ¡£è®°å½•
```

### 7.3 æœ€ä½³å®è·µæŒ‡å—


| å®è·µé¢†åŸŸ | **å…·ä½“å»ºè®®** | **é¿å…äº‹é¡¹** |
|---------|-------------|-------------|
| ğŸ”§ **é…ç½®å˜æ›´** | `å˜æ›´å‰å¿…é¡»å¤‡ä»½ï¼Œå˜æ›´åç«‹å³éªŒè¯` | `ç›´æ¥ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®` |
| ğŸ“ **è„šæœ¬å¼€å‘** | `å……åˆ†æµ‹è¯•ï¼Œæ·»åŠ é”™è¯¯å¤„ç†æœºåˆ¶` | `ç¼ºå°‘å¼‚å¸¸å¤„ç†å’Œå›æ»šé€»è¾‘` |
| ğŸš€ **æ‰¹é‡æ“ä½œ** | `å°æ‰¹é‡æµ‹è¯•ï¼Œé€æ­¥æ¨å¹¿` | `ä¸€æ¬¡æ€§æ“ä½œæ‰€æœ‰ä¸»æœº` |
| ğŸ›¡ï¸ **å®‰å…¨è€ƒè™‘** | `ä½¿ç”¨å¯†é’¥è®¤è¯ï¼Œé™åˆ¶è®¿é—®æƒé™` | `æ˜æ–‡å­˜å‚¨å¯†ç ï¼Œè¿‡åº¦æƒé™` |

### 7.4 æ•…éšœå¤„ç†æµç¨‹


```
ç½‘ç»œé…ç½®é—®é¢˜å‘ç”Ÿ
        â†“
å¿«é€Ÿè¯Šæ–­é—®é¢˜æ ¹æº
        â†“
æ£€æŸ¥å¤‡ä»½é…ç½®å¯ç”¨æ€§
        â†“
â”Œâ”€æ‰§è¡Œå›æ»šæ“ä½œâ”€â”      â”Œâ”€æ‰‹åŠ¨ä¿®å¤â”€â”
â”‚    â†“        â”‚      â”‚   â†“     â”‚
â”‚ éªŒè¯è¿æ¥æ€§    â”‚ æˆ–   â”‚ é€æ­¥æµ‹è¯• â”‚
â”‚    â†“        â”‚      â”‚   â†“     â”‚
â””â”€è®°å½•é—®é¢˜æ—¥å¿—â”€â”˜      â””â”€æ›´æ–°æ–‡æ¡£â”€â”˜
        â†“
æ€»ç»“ç»éªŒæ•™è®­ï¼Œå®Œå–„ç®¡ç†æœºåˆ¶
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é…ç½®åˆ‡æ¢è¦è°¨æ…ï¼Œå¤‡ä»½å…ˆè¡Œæ˜¯å…³é”®
- è„šæœ¬è‡ªåŠ¨ææ•ˆç‡ï¼ŒéªŒè¯å›æ»šä¿å®‰å…¨  
- æ‰¹é‡ç®¡ç†éœ€æ ‡å‡†ï¼Œç‰ˆæœ¬æ§åˆ¶åŠ©è¿½è¸ª
- æ•…éšœå¤„ç†æœ‰æµç¨‹ï¼Œç»éªŒæ€»ç»“ä¿ƒæ”¹è¿›