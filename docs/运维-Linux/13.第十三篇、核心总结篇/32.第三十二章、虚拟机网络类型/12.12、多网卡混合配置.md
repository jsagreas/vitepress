---
title: 12、多网卡混合配置
---
## 📚 目录

1. [多网卡配置基本概念](#1-多网卡配置基本概念)
2. [网络适配器基础配置](#2-网络适配器基础配置)
3. [网络接口绑定技术](#3-网络接口绑定技术)
4. [负载均衡与冗余配置](#4-负载均衡与冗余配置)
5. [路由表与流量控制](#5-路由表与流量控制)
6. [故障切换机制](#6-故障切换机制)
7. [实际应用场景](#7-实际应用场景)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌐 多网卡配置基本概念


### 1.1 什么是多网卡配置


**简单理解**：就像给一台电脑装多张网卡，每张网卡连接不同的网络

```
单网卡情况：
计算机 ──── [网卡1] ──── 网络A

多网卡情况：
计算机 ──┬─ [网卡1] ──── 网络A（内网）
         ├─ [网卡2] ──── 网络B（外网）
         └─ [网卡3] ──── 网络C（存储网络）
```

**为什么需要多网卡**：
- 🔸 **网络隔离**：不同业务走不同网络，互不干扰
- 🔸 **提高带宽**：多张网卡同时工作，总带宽增加
- 🔸 **增强可靠性**：一张网卡故障，其他网卡继续工作
- 🔸 **安全考虑**：内外网分离，提高安全性

### 1.2 多网卡的常见应用


**企业服务器典型配置**：
```
┌──────────────────┐
│    Linux服务器    │
├──────────────────┤
│ eth0: 管理网络    │ ← 192.168.1.100/24（管理维护）
│ eth1: 业务网络    │ ← 10.0.0.100/24（用户访问）
│ eth2: 存储网络    │ ← 172.16.0.100/24（数据存储）
│ eth3: 备份网络    │ ← 192.168.100.100/24（备份冗余）
└──────────────────┘
```

**网络角色说明**：
- **管理网络**：SSH远程管理、监控数据传输
- **业务网络**：用户访问、Web服务、API接口
- **存储网络**：数据库连接、文件存储访问
- **备份网络**：热备份、故障切换使用

### 1.3 多网卡配置的核心概念


**网络接口命名规则**：
```
传统命名：eth0, eth1, eth2...
新式命名：eno1, ens1, enp2s0...

查看网络接口：
ip link show
或
ls /sys/class/net/
```

**重要概念解释**：
- **网络接口**：系统识别的网络设备名称
- **IP地址**：每个接口分配的网络地址
- **网络段**：不同接口连接的网络范围
- **默认网关**：数据包的默认出口

---

## 2. 🔧 网络适配器基础配置


### 2.1 查看当前网络配置


**检查网络接口状态**：
```bash
# 查看所有网络接口
ip addr show

# 查看特定接口
ip addr show eth0

# 查看接口统计信息
cat /proc/net/dev
```

**输出示例解读**：
```
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500
    link/ether 00:15:5d:00:00:01 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.100/24 brd 192.168.1.255 scope global eth0

解释：
- UP: 接口已启用
- LOWER_UP: 物理链路已连接
- mtu 1500: 最大传输单元1500字节
- inet: IPv4地址信息
- /24: 子网掩码255.255.255.0
```

### 2.2 静态IP配置方法


**方法一：使用NetworkManager（推荐）**：
```bash
# 配置静态IP
nmcli con add type ethernet con-name eth0-static ifname eth0 \
    ip4 192.168.1.100/24 gw4 192.168.1.1

# 设置DNS
nmcli con mod eth0-static ipv4.dns "8.8.8.8,114.114.114.114"

# 激活配置
nmcli con up eth0-static
```

**方法二：直接编辑配置文件**：

在CentOS/RHEL系统中：
```bash
# 编辑网络配置文件
vim /etc/sysconfig/network-scripts/ifcfg-eth0
```

配置文件内容：
```
TYPE=Ethernet
BOOTPROTO=static
NAME=eth0
DEVICE=eth0
ONBOOT=yes
IPADDR=192.168.1.100
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1=8.8.8.8
DNS2=114.114.114.114
```

**重启网络服务**：
```bash
# CentOS 7+
systemctl restart NetworkManager

# 或者重启特定接口
ifdown eth0 && ifup eth0
```

### 2.3 多网卡基础配置示例


**配置三张网卡的完整示例**：

**eth0配置（管理网络）**：
```
# /etc/sysconfig/network-scripts/ifcfg-eth0
TYPE=Ethernet
BOOTPROTO=static
NAME=eth0-mgmt
DEVICE=eth0
ONBOOT=yes
IPADDR=192.168.1.100
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1=192.168.1.1
```

**eth1配置（业务网络）**：
```
# /etc/sysconfig/network-scripts/ifcfg-eth1
TYPE=Ethernet
BOOTPROTO=static
NAME=eth1-business
DEVICE=eth1
ONBOOT=yes
IPADDR=10.0.0.100
NETMASK=255.255.255.0
# 注意：只有一个接口设置GATEWAY
```

**eth2配置（存储网络）**：
```
# /etc/sysconfig/network-scripts/ifcfg-eth2
TYPE=Ethernet
BOOTPROTO=static
NAME=eth2-storage
DEVICE=eth2
ONBOOT=yes
IPADDR=172.16.0.100
NETMASK=255.255.255.0
```

> **⚠️ 重要提醒**：只能有一个默认网关，通常设置在主要的对外网络接口上。

---

## 3. 🔗 网络接口绑定技术


### 3.1 什么是网络接口绑定


**绑定（Bonding）的概念**：
把多张物理网卡"绑"在一起，对外表现为一张虚拟网卡

```
物理层面：
[eth0] ──┐
         ├─ 绑定 ─→ [bond0] ── 对外提供服务
[eth1] ──┘

逻辑层面：
应用程序只看到bond0这一张网卡
```

**绑定的好处**：
- 🔸 **带宽叠加**：两张1G网卡绑定 = 理论2G带宽
- 🔸 **故障切换**：一张网卡坏了，另一张自动接管
- 🔸 **负载均衡**：流量在多张网卡间分配

### 3.2 Bonding模式详解


**常用的7种绑定模式**：

| 模式 | **名称** | **特点** | **应用场景** |
|------|----------|----------|-------------|
| `0` | **balance-rr** | `轮询负载均衡，带宽叠加` | `高带宽需求，交换机支持` |
| `1` | **active-backup** | `主备模式，只有一张卡工作` | `高可用性要求，简单可靠` |
| `2` | **balance-xor** | `基于MAC地址哈希分发` | `平衡负载，交换机无特殊要求` |
| `4` | **802.3ad** | `IEEE 802.3ad链路聚合` | `企业级应用，需交换机支持` |
| `5` | **balance-tlb** | `发送负载均衡` | `服务器出站流量大` |
| `6` | **balance-alb** | `收发负载均衡` | `全双工负载均衡` |

**模式选择建议**：
- **新手推荐**：模式1（active-backup），简单可靠
- **追求性能**：模式0（balance-rr），需要交换机配置
- **企业级**：模式4（802.3ad），标准化方案

### 3.3 配置Bonding实例


**步骤1：加载bonding模块**
```bash
# 检查是否已加载
lsmod | grep bonding

# 临时加载
modprobe bonding

# 永久加载
echo "bonding" >> /etc/modules-load.d/bonding.conf
```

**步骤2：创建bond0配置文件**
```bash
# /etc/sysconfig/network-scripts/ifcfg-bond0
DEVICE=bond0
TYPE=Bond
NAME=bond0
BONDING_MASTER=yes
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.1.100
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
BONDING_OPTS="mode=1 miimon=100"
```

**步骤3：配置从属网卡**
```bash
# /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
TYPE=Ethernet
NAME=eth0
BOOTPROTO=none
ONBOOT=yes
MASTER=bond0
SLAVE=yes

# /etc/sysconfig/network-scripts/ifcfg-eth1
DEVICE=eth1
TYPE=Ethernet
NAME=eth1
BOOTPROTO=none
ONBOOT=yes
MASTER=bond0
SLAVE=yes
```

**步骤4：重启网络并验证**
```bash
# 重启网络
systemctl restart NetworkManager

# 查看bonding状态
cat /proc/net/bonding/bond0

# 测试故障切换
ifdown eth0  # 拔掉一张网卡的效果
```

**bonding状态解读**：
```
Bonding Mode: fault-tolerance (active-backup)
Primary Slave: None
Currently Active Slave: eth0
MII Status: up
MII Polling Interval (ms): 100
Up Delay (ms): 0
Down Delay (ms): 0

Slave Interface: eth0
MII Status: up         ← 网卡状态正常
Speed: 1000 Mbps
Duplex: full

Slave Interface: eth1
MII Status: up
Speed: 1000 Mbps  
Duplex: full
```

---

## 4. ⚖️ 负载均衡与冗余配置


### 4.1 负载均衡的工作原理


**什么是网络负载均衡**：
把网络流量分散到多张网卡上，就像多车道分流交通

```
单网卡瓶颈：
所有流量 ──→ [eth0] ──→ 1Gbps带宽限制

负载均衡：
流量A ──→ [eth0] ──┐
                   ├─ 2Gbps总带宽
流量B ──→ [eth1] ──┘
```

**负载均衡的实现方式**：
- **轮询分发**：数据包轮流从不同网卡发出
- **哈希分发**：根据源/目标地址计算走哪张网卡
- **动态调整**：根据网卡负载情况智能分配

### 4.2 高性能bonding配置


**mode=0配置示例（最大化带宽）**：
```bash
# bonding配置参数详解
BONDING_OPTS="mode=0 miimon=100 xmit_hash_policy=layer2"

参数说明：
- mode=0: 轮询模式，追求最大带宽
- miimon=100: 每100ms检查一次链路状态
- xmit_hash_policy=layer2: 基于MAC地址哈希
```

**交换机端配置要求**：
```
# 需要在交换机上配置端口聚合
interface GigabitEthernet 1/1
 channel-group 1 mode active

interface GigabitEthernet 1/2  
 channel-group 1 mode active
```

**mode=4配置示例（标准LACP）**：
```bash
# IEEE 802.3ad链路聚合
BONDING_OPTS="mode=4 miimon=100 lacp_rate=1"

参数说明：
- mode=4: IEEE 802.3ad动态链路聚合
- lacp_rate=1: LACP快速模式（每秒发送）
- lacp_rate=0: LACP慢速模式（每30秒发送）
```

### 4.3 网络冗余设计


**双网卡热备份配置**：
```bash
# 主备模式最简单的冗余方案
BONDING_OPTS="mode=1 miimon=100 primary=eth0"

工作机制：
正常情况: eth0工作，eth1待命
故障切换: eth0断开→自动切换到eth1
故障恢复: eth0恢复→自动切回eth0（如果设置了primary）
```

**多层次冗余架构**：
```
服务器层面：
bond0(eth0+eth1) ── 主要业务网络
bond1(eth2+eth3) ── 备份业务网络

网络层面：
主交换机 + 备交换机
主路由器 + 备路由器

链路层面：
主光纤 + 备光纤
主网线 + 备网线
```

---

## 5. 🛣️ 路由表与流量控制


### 5.1 理解路由表的作用


**路由表就像交通指示牌**：
告诉数据包"去哪个目的地应该走哪条路"

```bash
# 查看当前路由表
ip route show
# 或者
route -n
```

**典型路由表解读**：
```
Destination     Gateway         Genmask         Flags   Iface
0.0.0.0         192.168.1.1     0.0.0.0         UG      eth0
192.168.1.0     0.0.0.0         255.255.255.0   U       eth0  
10.0.0.0        0.0.0.0         255.255.255.0   U       eth1
172.16.0.0      0.0.0.0         255.255.255.0   U       eth2

解释：
- 第1行：默认路由，所有未匹配的流量走eth0到192.168.1.1
- 第2行：本地网络192.168.1.0/24直接通过eth0访问
- 第3行：10.0.0.0/24网络通过eth1访问
- 第4行：172.16.0.0/24网络通过eth2访问
```

### 5.2 多网卡路由配置


**基本路由添加**：
```bash
# 添加静态路由
ip route add 10.1.0.0/24 via 10.0.0.1 dev eth1

# 添加默认路由
ip route add default via 192.168.1.1 dev eth0

# 删除路由
ip route del 10.1.0.0/24

# 永久保存路由（CentOS）
echo "10.1.0.0/24 via 10.0.0.1 dev eth1" >> /etc/sysconfig/network-scripts/route-eth1
```

**路由优先级设置**：
```bash
# 设置路由优先级（metric值越小优先级越高）
ip route add default via 192.168.1.1 dev eth0 metric 100
ip route add default via 10.0.0.1 dev eth1 metric 200

查看效果：
ip route show
default via 192.168.1.1 dev eth0 metric 100    ← 优先使用
default via 10.0.0.1 dev eth1 metric 200       ← 备用路由
```

### 5.3 基于策略的路由


**什么是策略路由**：
不只看目标地址，还看源地址、端口等信息来决定路由

**实际应用场景**：
- 内网用户走内网网关
- 外网用户走外网网关  
- 管理流量走管理网络
- 业务流量走业务网络

**策略路由配置示例**：
```bash
# 创建路由表
echo "200 admin_table" >> /etc/iproute2/rt_tables
echo "201 business_table" >> /etc/iproute2/rt_tables

# 配置管理网络路由表
ip route add default via 192.168.1.1 dev eth0 table admin_table
ip route add 192.168.1.0/24 dev eth0 table admin_table

# 配置业务网络路由表  
ip route add default via 10.0.0.1 dev eth1 table business_table
ip route add 10.0.0.0/24 dev eth1 table business_table

# 配置路由规则
ip rule add from 192.168.1.0/24 table admin_table
ip rule add from 10.0.0.0/24 table business_table
```

**流量分离效果**：
```
管理员访问（从192.168.1.100发起）:
192.168.1.100 → 路由规则匹配 → admin_table → eth0网卡

用户访问（从10.0.0.100发起）:
10.0.0.100 → 路由规则匹配 → business_table → eth1网卡
```

---

## 6. 🔄 故障切换机制


### 6.1 故障检测机制


**MII监控（Media Independent Interface）**：
定期检查网卡的物理连接状态

```bash
# bonding中的MII监控配置
BONDING_OPTS="mode=1 miimon=100"

工作原理：
每100毫秒检查一次网卡状态
├─ 链路正常：继续使用
├─ 链路断开：标记网卡down
└─ 链路恢复：重新启用网卡
```

**ARP监控**：
通过发送ARP请求检查网络连通性

```bash
# ARP监控配置
BONDING_OPTS="mode=1 arp_interval=1000 arp_ip_target=192.168.1.1"

工作机制：
每1000毫秒向192.168.1.1发送ARP请求
├─ 收到ARP回复：网络正常
├─ 超时无回复：可能故障
└─ 连续失败：切换网卡
```

### 6.2 自动故障切换配置


**主备模式故障切换**：
```bash
# 完整的故障切换配置
BONDING_OPTS="mode=1 miimon=100 updelay=200 downdelay=200 primary=eth0"

参数详解：
- updelay=200: 网卡恢复后等待200ms再启用（避免抖动）
- downdelay=200: 网卡故障后等待200ms再切换（避免误判）
- primary=eth0: 指定eth0为首选网卡
```

**故障切换测试**：
```bash
# 模拟网卡故障
ifconfig eth0 down

# 观察切换过程
watch -n 1 'cat /proc/net/bonding/bond0 | grep "Currently Active Slave"'

# 模拟网卡恢复
ifconfig eth0 up

实际效果：
故障前: Currently Active Slave: eth0
故障时: Currently Active Slave: eth1  ← 自动切换
恢复后: Currently Active Slave: eth0  ← 自动切回
```

### 6.3 故障切换脚本


**监控脚本示例**：
```bash
#!/bin/bash
# /usr/local/bin/network_monitor.sh

LOG_FILE="/var/log/network_monitor.log"
BOND_DEVICE="bond0"

while true; do
    # 检查bonding状态
    ACTIVE_SLAVE=$(cat /proc/net/bonding/$BOND_DEVICE | grep "Currently Active Slave" | awk '{print $4}')
    BOND_STATUS=$(cat /proc/net/bonding/$BOND_DEVICE | grep "MII Status:" | head -1 | awk '{print $3}')
    
    # 记录状态变化
    echo "$(date): Bond $BOND_DEVICE - Active: $ACTIVE_SLAVE, Status: $BOND_STATUS" >> $LOG_FILE
    
    # 发送告警（可选）
    if [ "$ACTIVE_SLAVE" != "eth0" ]; then
        echo "WARNING: Primary network interface failed!" | mail -s "Network Alert" admin@company.com
    fi
    
    sleep 60
done
```

---

## 7. 🎯 实际应用场景


### 7.1 Web服务器配置方案


**典型Web服务器网络架构**：
```
┌─────────────────────┐
│    Web服务器        │
├─────────────────────┤
│ bond0(eth0+eth1):   │ ← 用户访问接口
│   10.0.1.100/24     │   高带宽，负载均衡
│                     │
│ eth2: 192.168.1.100 │ ← 管理维护接口
│       /24           │   SSH、监控
│                     │  
│ eth3: 172.16.1.100  │ ← 数据库连接接口
│       /24           │   后端数据访问
└─────────────────────┘
```

**配置要点**：
- **bond0**：面向用户的高性能接口，使用mode=4或mode=0
- **eth2**：独立的管理网络，保证运维安全
- **eth3**：专用数据库网络，避免业务流量干扰

### 7.2 数据库服务器配置


**数据库服务器网络需求**：
- 🔸 **高可用性**：数据库不能中断
- 🔸 **高带宽**：大量数据传输
- 🔸 **网络隔离**：前端访问与后端管理分离

**推荐配置方案**：
```bash
# 主要业务接口（高可用）
bond0: mode=1, primary=eth0
- 连接应用服务器
- 主备模式保证可用性

# 管理维护接口
eth2: 静态IP
- SSH管理
- 监控数据收集
- 备份传输

# 集群通信接口
eth3: 静态IP  
- 数据库集群心跳
- 数据同步
- 故障检测
```

### 7.3 企业网关服务器


**多网络环境接入**：
```
互联网 ─────── [eth0] ──┐
                       ├─ [Linux网关] ─ [eth2] ── 内网A（办公网络）
内部专线 ──── [eth1] ──┘                └─ [eth3] ── 内网B（服务器网络）
```

**路由配置策略**：
```bash
# 办公网络访问互联网
ip rule add from 192.168.1.0/24 table internet
ip route add default via [ISP_Gateway] dev eth0 table internet

# 服务器网络访问专线
ip rule add from 192.168.2.0/24 table private  
ip route add default via [Private_Gateway] dev eth1 table private

# 网络隔离规则
iptables -A FORWARD -i eth2 -o eth3 -j DROP  # 禁止办公网络直接访问服务器网络
iptables -A FORWARD -i eth3 -o eth2 -j DROP  # 禁止服务器网络直接访问办公网络
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基础概念


```
🔸 多网卡配置本质：给一台机器配置多个网络接口，实现不同网络的连接
🔸 网络接口绑定：将多张物理网卡绑定成一张虚拟网卡，提高性能和可靠性
🔸 路由表作用：告诉系统数据包应该从哪个接口发出去
🔸 故障切换：当主网卡出现问题时，自动切换到备用网卡
🔸 负载均衡：将网络流量分散到多张网卡上，提高总体性能
```

### 8.2 关键配置要点


**🔹 网卡配置注意事项**：
- 只能设置一个默认网关，避免路由冲突
- 不同网络使用不同的IP地址段
- 管理网络和业务网络要分离
- 配置文件修改后需要重启网络服务

**🔹 bonding模式选择**：
- **mode=1（active-backup）**：最简单可靠，适合新手
- **mode=0（balance-rr）**：最大化带宽，需要交换机支持
- **mode=4（802.3ad）**：企业标准，需要交换机配置LACP

**🔹 故障检测配置**：
- **miimon=100**：基础的物理链路检测，推荐使用
- **arp_interval + arp_ip_target**：网络连通性检测，更准确
- **updelay/downdelay**：避免网络抖动造成频繁切换

### 8.3 实际应用指导


**配置流程建议**：
1. **规划网络**：确定每张网卡的用途和IP地址段
2. **基础配置**：先配置单张网卡，确保能正常工作
3. **bonding配置**：需要高性能或高可用时再考虑绑定
4. **路由优化**：配置策略路由实现流量分离
5. **监控测试**：建立监控机制，定期测试故障切换

**常见错误避免**：
- ❌ 多张网卡设置相同网段的IP地址
- ❌ 多个接口都设置默认网关
- ❌ bonding配置后忘记配置交换机端
- ❌ 没有测试故障切换是否正常工作
- ❌ 缺乏网络监控和日志记录

**性能优化建议**：
- 🔸 根据实际需求选择合适的bonding模式
- 🔸 使用策略路由实现精确的流量控制
- 🔸 定期监控网络接口的流量和错误率
- 🔸 建立完善的故障切换测试机制

**安全考虑**：
- 🔸 管理网络与业务网络物理隔离
- 🔸 使用防火墙规则控制网络间的访问
- 🔸 监控异常的网络流量和连接
- 🔸 定期更新网络设备的固件和驱动

**核心记忆要点**：
- 多网卡配置核心是**网络隔离**和**性能提升**
- bonding的本质是**多卡合一**，提供**冗余和负载均衡**
- 路由表决定**数据包的转发路径**，策略路由实现**精细控制**
- 故障切换的关键是**及时检测**和**自动切换**
- 实际应用中要平衡**性能、可靠性和复杂性**