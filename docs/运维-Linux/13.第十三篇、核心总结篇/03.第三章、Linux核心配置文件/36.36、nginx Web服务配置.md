---
title: 36ã€nginx WebæœåŠ¡é…ç½®
---
## ğŸ“š ç›®å½•

1. [Nginxé…ç½®æ–‡ä»¶æ¦‚è¿°](#1-Nginxé…ç½®æ–‡ä»¶æ¦‚è¿°)
2. [ä¸»é…ç½®æ–‡ä»¶nginx.confè¯¦è§£](#2-ä¸»é…ç½®æ–‡ä»¶nginx.confè¯¦è§£)
3. [è™šæ‹Ÿä¸»æœºé…ç½®å®æˆ˜](#3-è™šæ‹Ÿä¸»æœºé…ç½®å®æˆ˜)
4. [è´Ÿè½½å‡è¡¡upstreamé…ç½®](#4-è´Ÿè½½å‡è¡¡upstreamé…ç½®)
5. [locationä½ç½®åŒ¹é…è§„åˆ™](#5-locationä½ç½®åŒ¹é…è§„åˆ™)
6. [åå‘ä»£ç†proxy_passé…ç½®](#6-åå‘ä»£ç†proxy_passé…ç½®)
7. [SSLè¯ä¹¦HTTPSé…ç½®](#7-SSLè¯ä¹¦HTTPSé…ç½®)
8. [æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨é…ç½®](#8-æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨é…ç½®)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Nginxé…ç½®æ–‡ä»¶æ¦‚è¿°


### 1.1 Nginxæ˜¯ä»€ä¹ˆ

**ç®€å•ç†è§£**ï¼šNginxå°±åƒä¸€ä¸ªè¶…çº§é—¨å«ï¼Œç«™åœ¨ä½ çš„æœåŠ¡å™¨å‰é¢ï¼Œå¸®ä½ å¤„ç†æ‰€æœ‰æ¥è®¿çš„ç½‘ç»œè¯·æ±‚ã€‚

```
ç”¨æˆ·è®¿é—® â†’ Nginxæ¥æ”¶ â†’ åˆ†å‘å¤„ç† â†’ è¿”å›ç»“æœ

æ¯”å¦‚ï¼š
- é™æ€æ–‡ä»¶ï¼šç›´æ¥è¿”å›HTMLã€CSSã€å›¾ç‰‡
- åŠ¨æ€è¯·æ±‚ï¼šè½¬å‘ç»™åç«¯åº”ç”¨å¤„ç†
- å¤šä¸ªæœåŠ¡ï¼šæ™ºèƒ½åˆ†é…åˆ°ä¸åŒæœåŠ¡å™¨
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸŒ **WebæœåŠ¡å™¨**ï¼šç›´æ¥æä¾›ç½‘é¡µè®¿é—®æœåŠ¡
- ğŸ”„ **åå‘ä»£ç†**ï¼šä»£æ›¿åç«¯æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚
- âš–ï¸ **è´Ÿè½½å‡è¡¡**ï¼šæŠŠè¯·æ±‚åˆ†æ•£åˆ°å¤šå°æœåŠ¡å™¨
- ğŸ“ **é™æ€æ–‡ä»¶æœåŠ¡**ï¼šé«˜æ•ˆå¤„ç†å›¾ç‰‡ã€CSSã€JSç­‰æ–‡ä»¶

### 1.2 é…ç½®æ–‡ä»¶ä½“ç³»ç»“æ„


**Nginxé…ç½®æ–‡ä»¶å°±åƒå…¬å¸çš„ç»„ç»‡æ¶æ„**ï¼š

```
Nginxé…ç½®ä½“ç³»
â”œâ”€â”€ /etc/nginx/nginx.conf          â† æ€»ç»ç†ï¼ˆä¸»é…ç½®æ–‡ä»¶ï¼‰
â”œâ”€â”€ /etc/nginx/conf.d/             â† å„éƒ¨é—¨ç»ç†ï¼ˆè™šæ‹Ÿä¸»æœºç›®å½•ï¼‰
â”‚   â”œâ”€â”€ default.conf               â† é»˜è®¤ç½‘ç«™é…ç½®
â”‚   â”œâ”€â”€ api.example.com.conf       â† APIæœåŠ¡é…ç½®
â”‚   â””â”€â”€ www.example.com.conf       â† ä¸»ç½‘ç«™é…ç½®
â”œâ”€â”€ /etc/nginx/sites-available/    â† å¤‡ç”¨é…ç½®ï¼ˆUbuntuç³»ç»Ÿï¼‰
â””â”€â”€ /var/log/nginx/                â† æ—¥å¿—æ–‡ä»¶ç›®å½•
```

**é…ç½®æ–‡ä»¶åŠ è½½é¡ºåº**ï¼š
1. **nginx.conf** - å…ˆè¯»å–ä¸»é…ç½®æ–‡ä»¶
2. **includeæŒ‡ä»¤** - æ ¹æ®ä¸»é…ç½®includeå…¶ä»–æ–‡ä»¶
3. **conf.d/*.conf** - è‡ªåŠ¨åŠ è½½è¿™ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰.confæ–‡ä»¶

---

## 2. ğŸ“‹ ä¸»é…ç½®æ–‡ä»¶nginx.confè¯¦è§£


### 2.1 é…ç½®æ–‡ä»¶ç»“æ„å±‚æ¬¡


**nginx.confå°±åƒä¸€ä¸ªä¿„ç½—æ–¯å¥—å¨ƒï¼Œä¸€å±‚å¥—ä¸€å±‚**ï¼š

```
å…¨å±€é…ç½®å—                    â† æœ€å¤–å±‚ï¼Œå½±å“æ•´ä¸ªNginx
â”œâ”€â”€ eventsé…ç½®å—              â† è¿æ¥å¤„ç†ç›¸å…³
â””â”€â”€ httpé…ç½®å—                â† HTTPç›¸å…³é…ç½®
    â”œâ”€â”€ upstreamé…ç½®å—        â† è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç»„
    â””â”€â”€ serveré…ç½®å—          â† è™šæ‹Ÿä¸»æœºé…ç½®
        â””â”€â”€ locationé…ç½®å—    â† å…·ä½“è·¯å¾„åŒ¹é…
```

### 2.2 å…¨å±€é…ç½®å—è¯¦è§£


**å…¨å±€é…ç½®å°±æ˜¯Nginxçš„"èº«ä»½è¯"ï¼Œå†³å®šå®ƒçš„åŸºæœ¬å±æ€§**ï¼š

```nginx
# è¿è¡Œç”¨æˆ·ï¼ˆå®‰å…¨è€ƒè™‘ï¼Œä¸ç”¨rootï¼‰
user nginx;

# å·¥ä½œè¿›ç¨‹æ•°ï¼ˆé€šå¸¸ç­‰äºCPUæ ¸å¿ƒæ•°ï¼‰
worker_processes auto;

# é”™è¯¯æ—¥å¿—ä½ç½®å’Œçº§åˆ«
error_log /var/log/nginx/error.log warn;

# è¿›ç¨‹IDæ–‡ä»¶ä½ç½®
pid /var/run/nginx.pid;
```

**é‡è¦å‚æ•°è§£é‡Š**ï¼š
- `user nginx` - è®©nginxç”¨æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œï¼Œæ›´å®‰å…¨
- `worker_processes auto` - è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•°ï¼Œåˆ›å»ºå¯¹åº”çš„å·¥ä½œè¿›ç¨‹
- `error_log` - å‡ºé”™æ—¶å†™æ—¥å¿—çš„åœ°æ–¹ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜

### 2.3 eventsé…ç½®å—è¯¦è§£


**eventså—å°±æ˜¯Nginxçš„"äº¤é€šè§„åˆ™"ï¼Œå†³å®šå¦‚ä½•å¤„ç†è¿æ¥**ï¼š

```nginx
events {
    # æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°
    worker_connections 1024;
    
    # äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼ˆLinuxç”¨epollæœ€å¥½ï¼‰
    use epoll;
    
    # å…è®¸ä¸€ä¸ªè¿›ç¨‹åŒæ—¶æ¥å—å¤šä¸ªè¿æ¥
    multi_accept on;
}
```

**å…³é”®æ¦‚å¿µ**ï¼š
- `worker_connections` - å°±åƒæœåŠ¡å‘˜èƒ½åŒæ—¶æ‹›å¾…å¤šå°‘æ¡Œå®¢äºº
- `epoll` - Linuxç³»ç»Ÿä¸‹æœ€é«˜æ•ˆçš„è¿æ¥å¤„ç†æ–¹å¼
- `multi_accept` - å…è®¸"ä¸€æ¬¡æ€§æ‹›å¾…å¤šæ¡Œå®¢äºº"

### 2.4 httpé…ç½®å—åŸºç¡€è®¾ç½®


**httpå—æ˜¯WebæœåŠ¡çš„"æ€»ç« ç¨‹"**ï¼š

```nginx
http {
    # æ–‡ä»¶ç±»å‹å®šä¹‰
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # æ—¥å¿—æ ¼å¼å®šä¹‰
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    # è®¿é—®æ—¥å¿—ä½ç½®
    access_log /var/log/nginx/access.log main;

    # é«˜æ•ˆæ–‡ä»¶ä¼ è¾“
    sendfile on;
    tcp_nopush on;
    
    # è¿æ¥è¶…æ—¶æ—¶é—´
    keepalive_timeout 65;
    
    # åŒ…å«å…¶ä»–é…ç½®æ–‡ä»¶
    include /etc/nginx/conf.d/*.conf;
}
```

---

## 3. ğŸ  è™šæ‹Ÿä¸»æœºé…ç½®å®æˆ˜


### 3.1 è™šæ‹Ÿä¸»æœºæ¦‚å¿µç†è§£


**è™šæ‹Ÿä¸»æœºå°±åƒå…¬å¯“æ¥¼ï¼Œä¸€å°æœåŠ¡å™¨å¯ä»¥"ä½"å¤šä¸ªç½‘ç«™**ï¼š

```
ä¸€å°æœåŠ¡å™¨çš„è™šæ‹Ÿä¸»æœºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰©ç†æœåŠ¡å™¨         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ç½‘ç«™A.com   â”‚    â”‚ â† ç‹¬ç«‹çš„ç½‘ç«™
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ç½‘ç«™B.com   â”‚    â”‚ â† å¦ä¸€ä¸ªç‹¬ç«‹ç½‘ç«™
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ API.com     â”‚    â”‚ â† APIæœåŠ¡
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åŸºç¡€è™šæ‹Ÿä¸»æœºé…ç½®


**åœ¨`/etc/nginx/conf.d/`ç›®å½•åˆ›å»ºé…ç½®æ–‡ä»¶**ï¼š

```nginx
# /etc/nginx/conf.d/www.example.com.conf
server {
    # ç›‘å¬ç«¯å£
    listen 80;
    
    # åŸŸåï¼ˆå¯ä»¥å¤šä¸ªï¼‰
    server_name www.example.com example.com;
    
    # ç½‘ç«™æ ¹ç›®å½•
    root /var/www/example.com;
    
    # é»˜è®¤é¦–é¡µæ–‡ä»¶
    index index.html index.php;
    
    # è®¿é—®æ—¥å¿—ï¼ˆå¯é€‰ï¼‰
    access_log /var/log/nginx/example.com.access.log;
    
    # åŸºæœ¬locationé…ç½®
    location / {
        try_files $uri $uri/ =404;
    }
}
```

**é…ç½®å‚æ•°è¯¦è§£**ï¼š
- `listen 80` - ç›‘å¬80ç«¯å£ï¼ˆHTTPé»˜è®¤ç«¯å£ï¼‰
- `server_name` - è¿™ä¸ªè™šæ‹Ÿä¸»æœºå“åº”å“ªäº›åŸŸå
- `root` - ç½‘ç«™æ–‡ä»¶å­˜æ”¾çš„ç›®å½•
- `index` - ç”¨æˆ·è®¿é—®ç›®å½•æ—¶æ˜¾ç¤ºå“ªä¸ªæ–‡ä»¶

### 3.3 å¤šåŸŸåå’Œå­åŸŸåé…ç½®


```nginx
# ä¸»ç½‘ç«™é…ç½®
server {
    listen 80;
    server_name example.com www.example.com;
    root /var/www/main;
    
    location / {
        try_files $uri $uri/ =404;
    }
}

# åšå®¢å­åŸŸå
server {
    listen 80;
    server_name blog.example.com;
    root /var/www/blog;
    
    location / {
        try_files $uri $uri/ =404;
    }
}

# APIå­åŸŸå
server {
    listen 80;
    server_name api.example.com;
    
    location / {
        proxy_pass http://localhost:3000;
    }
}
```

---

## 4. âš–ï¸ è´Ÿè½½å‡è¡¡upstreamé…ç½®


### 4.1 è´Ÿè½½å‡è¡¡åŸºæœ¬æ¦‚å¿µ


**è´Ÿè½½å‡è¡¡å°±åƒå¿«é€’åˆ†æ‹£ä¸­å¿ƒï¼ŒæŠŠåŒ…è£¹ï¼ˆè¯·æ±‚ï¼‰åˆ†é…åˆ°ä¸åŒçš„æ´¾é€å‘˜ï¼ˆæœåŠ¡å™¨ï¼‰**ï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ Nginxè´Ÿè½½å‡è¡¡å™¨ â†’ åˆ†å‘åˆ°ä¸åŒæœåŠ¡å™¨

è¯·æ±‚åˆ†å‘ç¤ºä¾‹ï¼š
è¯·æ±‚1 â†’ æœåŠ¡å™¨A
è¯·æ±‚2 â†’ æœåŠ¡å™¨B  
è¯·æ±‚3 â†’ æœåŠ¡å™¨C
è¯·æ±‚4 â†’ æœåŠ¡å™¨Aï¼ˆè½®è¯¢ï¼‰
```

### 4.2 upstreamåŸºç¡€é…ç½®


**upstreamå®šä¹‰æœåŠ¡å™¨ç»„ï¼Œé€šå¸¸å†™åœ¨httpå—å†…**ï¼š

```nginx
http {
    # å®šä¹‰åç«¯æœåŠ¡å™¨ç»„
    upstream backend_servers {
        # æœåŠ¡å™¨åˆ—è¡¨
        server 192.168.1.10:8080;
        server 192.168.1.11:8080;
        server 192.168.1.12:8080;
    }
    
    # è™šæ‹Ÿä¸»æœºä½¿ç”¨upstream
    server {
        listen 80;
        server_name app.example.com;
        
        location / {
            proxy_pass http://backend_servers;
        }
    }
}
```

### 4.3 è´Ÿè½½å‡è¡¡ç®—æ³•é…ç½®


| ç®—æ³•ç±»å‹ | **é…ç½®æ–¹å¼** | **å·¥ä½œåŸç†** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| ğŸ”„ **è½®è¯¢ï¼ˆé»˜è®¤ï¼‰** | `æ— éœ€é…ç½®` | ä¾æ¬¡åˆ†é…è¯·æ±‚ | æœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘ |
| âš–ï¸ **åŠ æƒè½®è¯¢** | `server IP weight=3` | æŒ‰æƒé‡æ¯”ä¾‹åˆ†é… | æœåŠ¡å™¨æ€§èƒ½ä¸åŒ |
| ğŸ“Š **æœ€å°‘è¿æ¥** | `least_conn;` | åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ | é•¿è¿æ¥æœåŠ¡ |
| ğŸ¯ **IPå“ˆå¸Œ** | `ip_hash;` | æ ¹æ®å®¢æˆ·ç«¯IPå›ºå®šåˆ†é… | éœ€è¦ä¼šè¯ä¿æŒ |

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š

```nginx
# åŠ æƒè½®è¯¢é…ç½®
upstream web_servers {
    server 192.168.1.10:8080 weight=3;  # æƒé‡3ï¼Œå¤„ç†èƒ½åŠ›å¼º
    server 192.168.1.11:8080 weight=1;  # æƒé‡1ï¼Œå¤„ç†èƒ½åŠ›å¼±
    server 192.168.1.12:8080 weight=2;  # æƒé‡2ï¼Œä¸­ç­‰å¤„ç†èƒ½åŠ›
}

# IPå“ˆå¸Œé…ç½®ï¼ˆä¼šè¯ä¿æŒï¼‰
upstream session_servers {
    ip_hash;
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
}

# æœ€å°‘è¿æ¥é…ç½®
upstream api_servers {
    least_conn;
    server 192.168.1.10:3000;
    server 192.168.1.11:3000;
}
```

### 4.4 æœåŠ¡å™¨å¥åº·æ£€æŸ¥


**å¥åº·æ£€æŸ¥å°±åƒå®šæœŸä½“æ£€ï¼Œç¡®ä¿æœåŠ¡å™¨æ­£å¸¸å·¥ä½œ**ï¼š

```nginx
upstream backend {
    server 192.168.1.10:8080 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:8080 max_fails=3 fail_timeout=30s;
    server 192.168.1.12:8080 backup;  # å¤‡ç”¨æœåŠ¡å™¨
}
```

**å‚æ•°è¯´æ˜**ï¼š
- `max_fails=3` - è¿ç»­å¤±è´¥3æ¬¡è®¤ä¸ºæœåŠ¡å™¨ä¸å¯ç”¨
- `fail_timeout=30s` - ä¸å¯ç”¨30ç§’åé‡æ–°å°è¯•
- `backup` - æ ‡è®°ä¸ºå¤‡ç”¨æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨éƒ½ä¸å¯ç”¨æ—¶æ‰ä½¿ç”¨

---

## 5. ğŸ“ locationä½ç½®åŒ¹é…è§„åˆ™


### 5.1 locationåŒ¹é…æ¦‚å¿µ


**locationå°±åƒé—¨ç‰Œå·ç³»ç»Ÿï¼Œå†³å®šä¸åŒçš„URLè·¯å¾„å¦‚ä½•å¤„ç†**ï¼š

```
ç½‘ç«™URLç»“æ„ï¼š
https://example.com/          â† é¦–é¡µ
https://example.com/api/      â† APIæ¥å£
https://example.com/images/   â† å›¾ç‰‡èµ„æº
https://example.com/admin/    â† ç®¡ç†åå°

æ¯ä¸ªè·¯å¾„ç”¨ä¸åŒçš„locationå¤„ç†
```

### 5.2 locationåŒ¹é…ä¼˜å…ˆçº§


**åŒ¹é…ä¼˜å…ˆçº§ä»é«˜åˆ°ä½**ï¼š

| ä¼˜å…ˆçº§ | **åŒ¹é…ç¬¦å·** | **åŒ¹é…ç±»å‹** | **ç¤ºä¾‹** |
|-------|-------------|-------------|---------|
| 1ï¸âƒ£ | `=` | ç²¾ç¡®åŒ¹é… | `location = /` |
| 2ï¸âƒ£ | `^~` | å‰ç¼€åŒ¹é…ï¼ˆä¼˜å…ˆï¼‰ | `location ^~ /images/` |
| 3ï¸âƒ£ | `~` | æ­£åˆ™åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ | `location ~ \.php$` |
| 4ï¸âƒ£ | `~*` | æ­£åˆ™åŒ¹é…ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ | `location ~* \.(jpg|png)$` |
| 5ï¸âƒ£ | `/` | æ™®é€šå‰ç¼€åŒ¹é… | `location /api/` |

### 5.3 å¸¸ç”¨locationé…ç½®ç¤ºä¾‹


```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/example.com;
    
    # 1. ç²¾ç¡®åŒ¹é…é¦–é¡µ
    location = / {
        index index.html;
    }
    
    # 2. é™æ€æ–‡ä»¶å¤„ç†ï¼ˆå›¾ç‰‡ã€CSSã€JSï¼‰
    location ~* \.(jpg|jpeg|png|gif|css|js)$ {
        expires 1d;  # ç¼“å­˜1å¤©
        add_header Cache-Control "public, immutable";
    }
    
    # 3. APIæ¥å£ä»£ç†
    location /api/ {
        proxy_pass http://localhost:3000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # 4. ç®¡ç†åå°ï¼ˆéœ€è¦è®¤è¯ï¼‰
    location /admin/ {
        auth_basic "Admin Area";
        auth_basic_user_file /etc/nginx/passwords;
        try_files $uri $uri/ =404;
    }
    
    # 5. ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
    }
}
```

### 5.4 locationå†…ç½®å˜é‡


**Nginxæä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„å˜é‡**ï¼š

```nginx
location /debug/ {
    # è¿”å›è°ƒè¯•ä¿¡æ¯
    add_header X-URI $uri;
    add_header X-Args $args;
    add_header X-Real-IP $remote_addr;
    add_header X-Host $host;
    return 200 "Debug Info";
}
```

**å¸¸ç”¨å˜é‡è¯´æ˜**ï¼š
- `$uri` - å½“å‰è¯·æ±‚çš„URIè·¯å¾„
- `$args` - URLå‚æ•°éƒ¨åˆ†
- `$remote_addr` - å®¢æˆ·ç«¯IPåœ°å€
- `$host` - è¯·æ±‚çš„ä¸»æœºå
- `$scheme` - åè®®åï¼ˆhttpæˆ–httpsï¼‰

---

## 6. ğŸ”„ åå‘ä»£ç†proxy_passé…ç½®


### 6.1 åå‘ä»£ç†æ¦‚å¿µç†è§£


**åå‘ä»£ç†å°±åƒå…¬å¸å‰å°ï¼Œå®¢æˆ·ä¸çŸ¥é“å…·ä½“ä¸šåŠ¡æ˜¯å“ªä¸ªéƒ¨é—¨å¤„ç†çš„**ï¼š

```
ä¼ ç»Ÿç›´æ¥è®¿é—®ï¼š
å®¢æˆ· â†’ ç›´æ¥è®¿é—®åç«¯æœåŠ¡å™¨

åå‘ä»£ç†ï¼š
å®¢æˆ· â†’ Nginxä»£ç† â†’ åç«¯æœåŠ¡å™¨
     â†‘          â†“
   åªçŸ¥é“ä»£ç†åœ°å€   ä»£ç†è½¬å‘è¯·æ±‚
```

**åå‘ä»£ç†çš„å¥½å¤„**ï¼š
- ğŸ”’ **éšè—åç«¯**ï¼šå®¢æˆ·ç«¯ä¸çŸ¥é“çœŸå®æœåŠ¡å™¨åœ°å€
- âš–ï¸ **è´Ÿè½½å‡è¡¡**ï¼šåˆ†æ•£è¯·æ±‚åˆ°å¤šå°æœåŠ¡å™¨
- ğŸš€ **ç¼“å­˜åŠ é€Ÿ**ï¼šä»£ç†å¯ä»¥ç¼“å­˜å“åº”å†…å®¹
- ğŸ›¡ï¸ **å®‰å…¨è¿‡æ»¤**ï¼šåœ¨ä»£ç†å±‚è¿›è¡Œå®‰å…¨æ£€æŸ¥

### 6.2 åŸºç¡€proxy_passé…ç½®


```nginx
server {
    listen 80;
    server_name api.example.com;
    
    location / {
        # ä»£ç†åˆ°åç«¯æœåŠ¡
        proxy_pass http://localhost:3000;
        
        # ä¼ é€’å®¢æˆ·ç«¯çœŸå®ä¿¡æ¯
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 6.3 proxy_passè·¯å¾„å¤„ç†è§„åˆ™


**proxy_passçš„è·¯å¾„å¤„ç†å¾ˆé‡è¦ï¼Œä¸€ä¸ªæ–œæ çš„å·®å¼‚ä¼šå¯¼è‡´ä¸åŒç»“æœ**ï¼š

```nginx
# æƒ…å†µ1ï¼šproxy_passåæ²¡æœ‰è·¯å¾„
location /api/ {
    proxy_pass http://backend;
}
# è¯·æ±‚ /api/users â†’ è½¬å‘åˆ° http://backend/api/users

# æƒ…å†µ2ï¼šproxy_passåæœ‰è·¯å¾„ï¼ˆæ³¨æ„æ–œæ ï¼‰
location /api/ {
    proxy_pass http://backend/;
}
# è¯·æ±‚ /api/users â†’ è½¬å‘åˆ° http://backend/users

# æƒ…å†µ3ï¼šproxy_passåæœ‰å…·ä½“è·¯å¾„
location /api/ {
    proxy_pass http://backend/v1/;
}
# è¯·æ±‚ /api/users â†’ è½¬å‘åˆ° http://backend/v1/users
```

### 6.4 é«˜çº§ä»£ç†é…ç½®


```nginx
location /app/ {
    proxy_pass http://app_servers;
    
    # è¶…æ—¶è®¾ç½®
    proxy_connect_timeout 30s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # ç¼“å†²è®¾ç½®
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    
    # é”™è¯¯å¤„ç†
    proxy_next_upstream error timeout http_500 http_502 http_503;
    
    # WebSocketæ”¯æŒ
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
```

---

## 7. ğŸ”’ SSLè¯ä¹¦HTTPSé…ç½®


### 7.1 HTTPSåŸºæœ¬æ¦‚å¿µ


**HTTP vs HTTPSçš„åŒºåˆ«**ï¼š

```
HTTPï¼ˆä¸å®‰å…¨ï¼‰ï¼š
æµè§ˆå™¨ â†â†’ æ˜æ–‡ä¼ è¾“ â†â†’ æœåŠ¡å™¨
       å®¹æ˜“è¢«çªƒå¬å’Œç¯¡æ”¹

HTTPSï¼ˆå®‰å…¨ï¼‰ï¼š
æµè§ˆå™¨ â†â†’ SSL/TLSåŠ å¯† â†â†’ æœåŠ¡å™¨
       æ•°æ®åŠ å¯†ä¼ è¾“ï¼Œå®‰å…¨å¯é 
```

**SSLè¯ä¹¦çš„ä½œç”¨**ï¼š
- ğŸ” **æ•°æ®åŠ å¯†**ï¼šé˜²æ­¢ä¼ è¾“è¿‡ç¨‹ä¸­è¢«çªƒå¬
- ğŸ›¡ï¸ **èº«ä»½éªŒè¯**ï¼šè¯æ˜ç½‘ç«™èº«ä»½çš„çœŸå®æ€§
- ğŸ”’ **æ•°æ®å®Œæ•´æ€§**ï¼šé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹

### 7.2 SSLè¯ä¹¦è·å–æ–¹å¼


**å…è´¹è¯ä¹¦**ï¼š
- **Let's Encrypt** - å…è´¹ä½†90å¤©æœ‰æ•ˆæœŸ
- **äº‘æœåŠ¡å•†** - é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰æä¾›å…è´¹è¯ä¹¦

**ä»˜è´¹è¯ä¹¦**ï¼š
- **DVè¯ä¹¦** - åŸŸåéªŒè¯ï¼Œé€‚åˆä¸ªäººç½‘ç«™
- **OVè¯ä¹¦** - ç»„ç»‡éªŒè¯ï¼Œé€‚åˆä¼ä¸šç½‘ç«™
- **EVè¯ä¹¦** - æ‰©å±•éªŒè¯ï¼Œæœ€é«˜çº§åˆ«

### 7.3 HTTPSåŸºç¡€é…ç½®


```nginx
server {
    listen 443 ssl http2;  # å¯ç”¨SSLå’ŒHTTP/2
    server_name example.com www.example.com;
    
    # SSLè¯ä¹¦æ–‡ä»¶
    ssl_certificate /etc/nginx/ssl/example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/example.com.key;
    
    # SSLåè®®ç‰ˆæœ¬
    ssl_protocols TLSv1.2 TLSv1.3;
    
    # åŠ å¯†å¥—ä»¶
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers on;
    
    # ç½‘ç«™å†…å®¹
    root /var/www/example.com;
    index index.html;
    
    location / {
        try_files $uri $uri/ =404;
    }
}

# HTTPè‡ªåŠ¨è·³è½¬HTTPS
server {
    listen 80;
    server_name example.com www.example.com;
    return 301 https://$server_name$request_uri;
}
```

### 7.4 Let's Encryptå…è´¹è¯ä¹¦é…ç½®


**ä½¿ç”¨certbotè‡ªåŠ¨è·å–è¯ä¹¦**ï¼š

```bash
# å®‰è£…certbot
sudo apt-get install certbot python3-certbot-nginx

# è‡ªåŠ¨è·å–è¯ä¹¦å¹¶é…ç½®
sudo certbot --nginx -d example.com -d www.example.com

# è‡ªåŠ¨ç»­æœŸï¼ˆæ·»åŠ åˆ°crontabï¼‰
0 12 * * * /usr/bin/certbot renew --quiet
```

### 7.5 SSLå®‰å…¨å¢å¼ºé…ç½®


```nginx
server {
    listen 443 ssl http2;
    server_name example.com;
    
    # åŸºç¡€SSLé…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/private.key;
    
    # å®‰å…¨å¤´éƒ¨
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # OCSPè£…è®¢
    ssl_stapling on;
    ssl_stapling_verify on;
    ssl_trusted_certificate /path/to/chain.pem;
    
    location / {
        root /var/www/example.com;
        index index.html;
    }
}
```

---

## 8. ğŸš€ æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨é…ç½®


### 8.1 æ€§èƒ½ä¼˜åŒ–é…ç½®


**Gzipå‹ç¼©é…ç½®**ï¼š

```nginx
http {
    # å¼€å¯gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
    
    # æ–‡ä»¶ç¼“å­˜
    open_file_cache max=1000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
}

server {
    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # å¼€å¯HTTP/2
    listen 443 ssl http2;
}
```

### 8.2 å®‰å…¨é…ç½®


**åŸºç¡€å®‰å…¨é˜²æŠ¤**ï¼š

```nginx
http {
    # éšè—ç‰ˆæœ¬ä¿¡æ¯
    server_tokens off;
    
    # é™åˆ¶è¯·æ±‚å¤§å°
    client_max_body_size 10M;
    
    # é™åˆ¶è¯·æ±‚é¢‘ç‡
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    
    # é™åˆ¶è¿æ¥æ•°
    limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m;
}

server {
    # åº”ç”¨é™æµ
    limit_req zone=api burst=20 nodelay;
    limit_conn conn_limit_per_ip 10;
    
    # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~ /\.(ht|git|svn) {
        deny all;
    }
    
    # é˜²æ­¢SQLæ³¨å…¥å’ŒXSS
    location ~ .*\.(php|jsp|asp)$ {
        # è¿™é‡Œå¯ä»¥æ·»åŠ WAFè§„åˆ™
        proxy_pass http://backend;
    }
}
```

### 8.3 æ—¥å¿—é…ç½®å’Œç›‘æ§


```nginx
http {
    # è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    '$request_time $upstream_response_time';
    
    # é”™è¯¯æ—¥å¿—çº§åˆ«
    error_log /var/log/nginx/error.log warn;
}

server {
    # è®¿é—®æ—¥å¿—
    access_log /var/log/nginx/example.com.access.log main;
    
    # ç‰¹å®šlocationçš„æ—¥å¿—
    location /api/ {
        access_log /var/log/nginx/api.access.log main;
        proxy_pass http://api_servers;
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é…ç½®æ–‡ä»¶ç»“æ„ï¼šnginx.confä¸»é…ç½® + conf.dè™šæ‹Ÿä¸»æœºé…ç½®
ğŸ”¸ è™šæ‹Ÿä¸»æœºï¼šä¸€å°æœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªç½‘ç«™çš„æŠ€æœ¯
ğŸ”¸ upstreamè´Ÿè½½å‡è¡¡ï¼šå°†è¯·æ±‚åˆ†å‘åˆ°å¤šå°åç«¯æœåŠ¡å™¨
ğŸ”¸ locationåŒ¹é…ï¼šæ ¹æ®URLè·¯å¾„å†³å®šå¦‚ä½•å¤„ç†è¯·æ±‚
ğŸ”¸ åå‘ä»£ç†ï¼šä»£ç†åç«¯æœåŠ¡ï¼Œæä¾›ç»Ÿä¸€å…¥å£
ğŸ”¸ SSL/HTTPSï¼šåŠ å¯†ä¼ è¾“ï¼Œä¿è¯æ•°æ®å®‰å…¨
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šç¼“å­˜ã€å‹ç¼©ã€é™æµç­‰æå‡æ€§èƒ½
```

### 9.2 å…³é”®é…ç½®ç†è§£è¦ç‚¹


**ğŸ”¹ é…ç½®æ–‡ä»¶å±‚æ¬¡å…³ç³»**
```
è®°å¿†æ–¹æ³•ï¼š
- å…¨å±€é…ç½®å½±å“æ•´ä¸ªNginx
- eventsé…ç½®è¿æ¥å¤„ç†
- httpé…ç½®WebæœåŠ¡
- serveré…ç½®è™šæ‹Ÿä¸»æœº
- locationé…ç½®å…·ä½“è·¯å¾„å¤„ç†
```

**ğŸ”¹ proxy_passè·¯å¾„è§„åˆ™**
```
é‡è¦æé†’ï¼š
- æœ‰æ–œæ ï¼šæ›¿æ¢locationåŒ¹é…éƒ¨åˆ†
- æ— æ–œæ ï¼šè¿½åŠ å®Œæ•´è¯·æ±‚è·¯å¾„
- è¿™ä¸ªç»†èŠ‚å¾ˆå®¹æ˜“å‡ºé”™ï¼
```

**ğŸ”¹ SSLé…ç½®è¦ç‚¹**
```
å®‰å…¨è¦ç‚¹ï¼š
- ä½¿ç”¨TLS 1.2+åè®®
- é…ç½®å®‰å…¨çš„åŠ å¯†å¥—ä»¶
- æ·»åŠ å®‰å…¨å“åº”å¤´
- å®šæœŸæ›´æ–°è¯ä¹¦
```

### 9.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ“Š å…¸å‹åº”ç”¨æ¶æ„**

```
äº’è”ç½‘ç”¨æˆ·
      â†“
   Nginxä»£ç†
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é™æ€æ–‡ä»¶æœåŠ¡    â”‚ â† ç›´æ¥è¿”å›CSSã€JSã€å›¾ç‰‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  APIæœåŠ¡ä»£ç†     â”‚ â† è½¬å‘åˆ°åç«¯APIæœåŠ¡å™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Webåº”ç”¨ä»£ç†     â”‚ â† è½¬å‘åˆ°åº”ç”¨æœåŠ¡å™¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ é…ç½®æœ€ä½³å®è·µ**
- **æ¨¡å—åŒ–é…ç½®**ï¼šä¸åŒç½‘ç«™ç”¨ä¸åŒé…ç½®æ–‡ä»¶
- **å®‰å…¨ç¬¬ä¸€**ï¼šåŠæ—¶æ›´æ–°ã€é…ç½®é˜²æŠ¤è§„åˆ™
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯ç”¨ç¼“å­˜ã€å‹ç¼©ã€HTTP/2
- **ç›‘æ§æ—¥å¿—**ï¼šå®šæœŸæ£€æŸ¥è®¿é—®å’Œé”™è¯¯æ—¥å¿—
- **å¤‡ä»½é…ç½®**ï¼šä¿®æ”¹å‰å¤‡ä»½é…ç½®æ–‡ä»¶

**ğŸ’¡ å¸¸è§é—®é¢˜æ’æŸ¥**
- **502é”™è¯¯**ï¼šæ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸
- **404é”™è¯¯**ï¼šæ£€æŸ¥rootè·¯å¾„å’Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨
- **SSLè¯ä¹¦**ï¼šæ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸå’ŒåŸŸååŒ¹é…
- **æ€§èƒ½é—®é¢˜**ï¼šæ£€æŸ¥upstreamæœåŠ¡å™¨çŠ¶æ€

**æ ¸å¿ƒè®°å¿†**ï¼š
- Nginxé…ç½®æœ‰å±‚æ¬¡ï¼Œç†è§£ç»“æ„æ˜¯å…³é”®
- locationåŒ¹é…æœ‰ä¼˜å…ˆçº§ï¼Œç²¾ç¡®åŒ¹é…ä¼˜å…ˆ
- proxy_passè·¯å¾„å¤„ç†è¦å°å¿ƒæ–œæ 
- SSLé…ç½®å…³ç³»å®‰å…¨ï¼Œç»†èŠ‚ä¸èƒ½é©¬è™
- æ€§èƒ½ä¼˜åŒ–è¦å…¨é¢ï¼Œç¼“å­˜å‹ç¼©é™æµéƒ½è¦åš