---
title: 19ã€Linux Capabilitiesæƒé™
---
## ğŸ“š ç›®å½•


1. [Capabilitiesæ¦‚å¿µä¸åˆ†ç±»](#1-capabilitiesæ¦‚å¿µä¸åˆ†ç±»)
2. [getcapæŸ¥çœ‹ç¨‹åºæƒé™](#2-getcapæŸ¥çœ‹ç¨‹åºæƒé™)
3. [setcapè®¾ç½®ç¨‹åºæƒé™](#3-setcapè®¾ç½®ç¨‹åºæƒé™)
4. [æ–‡ä»¶Capabilities vs è¿›ç¨‹Capabilities](#4-æ–‡ä»¶capabilities-vs-è¿›ç¨‹capabilities)
5. [å¸¸ç”¨Capabilitiesæƒé™è¯´æ˜](#5-å¸¸ç”¨capabilitiesæƒé™è¯´æ˜)
6. [Capabilitieså®‰å…¨ä¼˜åŠ¿](#6-capabilitieså®‰å…¨ä¼˜åŠ¿)
7. [Capabilitiesæ•…éšœæ’æŸ¥](#7-capabilitiesæ•…éšœæ’æŸ¥)
8. [Capabilitiesæœ€ä½³å®è·µ](#8-capabilitiesæœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Capabilitiesæ¦‚å¿µä¸åˆ†ç±»



### 1.1 ä»€ä¹ˆæ˜¯Capabilities



**æ ¸å¿ƒæ¦‚å¿µ**ï¼šCapabilitiesï¼ˆèƒ½åŠ›ï¼‰æ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ç§**ç»†ç²’åº¦æƒé™æ§åˆ¶æœºåˆ¶**ï¼Œå®ƒå°†ä¼ ç»Ÿçš„rootè¶…çº§ç”¨æˆ·æƒé™**æ‹†åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„èƒ½åŠ›å•å…ƒ**ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šä¼ ç»Ÿçš„Linuxç³»ç»Ÿå°±åƒä¸€æŠŠ"ä¸‡èƒ½é’¥åŒ™"ï¼ˆrootæƒé™ï¼‰ï¼Œè€ŒCapabilitieså°±æ˜¯æŠŠè¿™æŠŠä¸‡èƒ½é’¥åŒ™æ‹†åˆ†æˆè®¸å¤šæŠŠ"ä¸“ç”¨é’¥åŒ™"ï¼Œæ¯æŠŠé’¥åŒ™åªèƒ½å¼€ç‰¹å®šçš„é—¨ã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Capabilities



**ä¼ ç»Ÿæƒé™æ¨¡å‹çš„é—®é¢˜**ï¼š
```
ä¼ ç»Ÿæ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ™®é€šç”¨æˆ·   â”‚    â”‚  rootç”¨æˆ·   â”‚
â”‚  æƒé™æœ‰é™   â”‚    â”‚   å…¨éƒ¨æƒé™   â”‚
â”‚  å¾ˆå¤šäº‹åšä¸äº† â”‚    â”‚   å®‰å…¨é£é™©å¤§ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘                â†‘
    æƒé™ä¸å¤Ÿç”¨        æƒé™è¿‡å¤§ä¸å®‰å…¨
```

**Capabilitiesæ¨¡å‹çš„ä¼˜åŠ¿**ï¼š
```
Capabilitiesæ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç»†åˆ†æƒé™èƒ½åŠ›               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç½‘ç»œæƒé™ â”‚ æ–‡ä»¶æƒé™ â”‚ ç³»ç»Ÿæƒé™ â”‚ ... â”‚
â”‚CAP_NET_*â”‚CAP_DAC_*â”‚CAP_SYS_*â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
   æŒ‰éœ€åˆ†é…æƒé™ï¼Œæ—¢å®‰å…¨åˆå¤Ÿç”¨
```

### 1.3 Capabilitiesåˆ†ç±»ä½“ç³»



**æƒé™åˆ†ç±»æ¶æ„**ï¼š
```
Linux Capabilities
â”œâ”€â”€ æ–‡ä»¶ç³»ç»Ÿç›¸å…³
â”‚   â”œâ”€â”€ CAP_DAC_OVERRIDE     # ç»•è¿‡æ–‡ä»¶æƒé™æ£€æŸ¥
â”‚   â”œâ”€â”€ CAP_DAC_READ_SEARCH  # ç»•è¿‡è¯»å–å’Œæœç´¢æƒé™
â”‚   â””â”€â”€ CAP_FOWNER          # ç»•è¿‡æ–‡ä»¶æ‰€æœ‰è€…æ£€æŸ¥
â”œâ”€â”€ ç½‘ç»œç›¸å…³
â”‚   â”œâ”€â”€ CAP_NET_ADMIN       # ç½‘ç»œç®¡ç†æƒé™
â”‚   â”œâ”€â”€ CAP_NET_BIND_SERVICE # ç»‘å®šç‰¹æƒç«¯å£(<1024)
â”‚   â””â”€â”€ CAP_NET_RAW         # åˆ›å»ºåŸå§‹å¥—æ¥å­—
â”œâ”€â”€ ç³»ç»Ÿç®¡ç†ç›¸å…³
â”‚   â”œâ”€â”€ CAP_SYS_ADMIN       # ç³»ç»Ÿç®¡ç†æƒé™
â”‚   â”œâ”€â”€ CAP_SYS_TIME        # ä¿®æ”¹ç³»ç»Ÿæ—¶é—´
â”‚   â””â”€â”€ CAP_SYS_MODULE      # åŠ è½½å†…æ ¸æ¨¡å—
â””â”€â”€ è¿›ç¨‹ç›¸å…³
    â”œâ”€â”€ CAP_KILL            # å‘é€ä¿¡å·ç»™ä»»æ„è¿›ç¨‹
    â”œâ”€â”€ CAP_SETUID          # è®¾ç½®ç”¨æˆ·ID
    â””â”€â”€ CAP_SETGID          # è®¾ç½®ç»„ID
```

### 1.4 Capabilitiesçš„ä¸‰ç§çŠ¶æ€



**èƒ½åŠ›çŠ¶æ€è¯´æ˜**ï¼š

| çŠ¶æ€ç±»å‹ | **è‹±æ–‡åç§°** | **ä½œç”¨è¯´æ˜** | **ç”Ÿæ•ˆæ—¶æœº** |
|---------|-------------|-------------|-------------|
| ğŸŸ¢ **æœ‰æ•ˆ** | `Effective` | `å½“å‰ç”Ÿæ•ˆçš„æƒé™` | `ç¨‹åºè¿è¡Œæ—¶ç«‹å³å¯ç”¨` |
| ğŸ”µ **å…è®¸** | `Permitted` | `ç¨‹åºè¢«å…è®¸æ‹¥æœ‰çš„æƒé™` | `å¯ä»¥è½¬æ¢ä¸ºæœ‰æ•ˆæƒé™` |
| ğŸŸ¡ **ç»§æ‰¿** | `Inheritable` | `å¯ä»¥ä¼ é€’ç»™å­è¿›ç¨‹çš„æƒé™` | `fork/execæ—¶ä¼ é€’` |

**çŠ¶æ€è½¬æ¢å…³ç³»**ï¼š
```
ç¨‹åºå¯åŠ¨æ—¶ï¼š
Permittedæƒé™ â†’ å¯ä»¥æ¿€æ´» â†’ Effectiveæƒé™ â†’ å®é™…ç”Ÿæ•ˆ
     â†“
Inheritableæƒé™ â†’ ä¼ é€’ç»™å­è¿›ç¨‹
```

---

## 2. ğŸ” getcapæŸ¥çœ‹ç¨‹åºæƒé™



### 2.1 getcapåŸºæœ¬ç”¨æ³•



**å‘½ä»¤æ ¼å¼**ï¼š
```bash
getcap [é€‰é¡¹] æ–‡ä»¶è·¯å¾„
```

**å¸¸ç”¨é€‰é¡¹**ï¼š
- `-r` : é€’å½’æŸ¥çœ‹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
- `-v` : æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

### 2.2 æŸ¥çœ‹å•ä¸ªç¨‹åºæƒé™



**æŸ¥çœ‹å…·ä½“ç¨‹åº**ï¼š
```bash
# æŸ¥çœ‹pingç¨‹åºçš„æƒé™

$ getcap /bin/ping
/bin/ping = cap_net_raw+ep

# æŸ¥çœ‹tcpdumpç¨‹åºæƒé™

$ getcap /usr/sbin/tcpdump
/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip
```

**æƒé™æ ‡è®°å«ä¹‰**ï¼š
- `e` : effectiveï¼ˆæœ‰æ•ˆæƒé™ï¼‰
- `p` : permittedï¼ˆå…è®¸æƒé™ï¼‰  
- `i` : inheritableï¼ˆç»§æ‰¿æƒé™ï¼‰
- `+` : è¡¨ç¤ºè®¾ç½®è¿™äº›æƒé™

> ğŸ“– **è§£è¯»ç¤ºä¾‹**ï¼š`cap_net_raw+ep` è¡¨ç¤ºç¨‹åºæ‹¥æœ‰ç½‘ç»œåŸå§‹å¥—æ¥å­—æƒé™ï¼Œä¸”è¯¥æƒé™åœ¨æœ‰æ•ˆ(e)å’Œå…è®¸(p)çŠ¶æ€ä¸‹éƒ½å¯ç”¨ã€‚

### 2.3 æ‰¹é‡æŸ¥çœ‹ç³»ç»Ÿæƒé™



**é€’å½’æŸ¥çœ‹ç›®å½•**ï¼š
```bash
# æŸ¥çœ‹/binç›®å½•ä¸‹æ‰€æœ‰ç¨‹åºæƒé™

$ getcap -r /bin

# æŸ¥çœ‹/usr/binç›®å½•æƒé™ï¼ˆå¸¸ç”¨ï¼‰

$ getcap -r /usr/bin 2>/dev/null

# æŸ¥çœ‹æ•´ä¸ªç³»ç»Ÿçš„capabilitiesï¼ˆè€—æ—¶è¾ƒé•¿ï¼‰

$ getcap -r / 2>/dev/null | head -20
```

**å¸¸è§è¾“å‡ºç¤ºä¾‹**ï¼š
```bash
/bin/ping = cap_net_raw+ep
/usr/bin/arping = cap_net_raw+ep
/usr/bin/clockdiff = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip
```

### 2.4 æŸ¥çœ‹è¿›ç¨‹è¿è¡Œæ—¶æƒé™



**æŸ¥çœ‹å½“å‰è¿›ç¨‹æƒé™**ï¼š
```bash
# æŸ¥çœ‹å½“å‰shellè¿›ç¨‹æƒé™

$ cat /proc/self/status | grep Cap
CapInh: 0000000000000000
CapPrm: 0000000000000000
CapEff: 0000000000000000
CapBnd: 0000003fffffffff
CapAmb: 0000000000000000
```

**æƒé™å­—æ®µå«ä¹‰**ï¼š
- `CapInh` : Inheritable capabilities
- `CapPrm` : Permitted capabilities  
- `CapEff` : Effective capabilities
- `CapBnd` : Bounding set
- `CapAmb` : Ambient capabilities

---

## 3. âš™ï¸ setcapè®¾ç½®ç¨‹åºæƒé™



### 3.1 setcapåŸºæœ¬è¯­æ³•



**å‘½ä»¤æ ¼å¼**ï¼š
```bash
setcap æƒé™è®¾ç½® æ–‡ä»¶è·¯å¾„
```

**æƒé™è®¾ç½®è¯­æ³•**ï¼š
```
cap_æƒé™åç§°+æƒé™æ ‡è®°
```

### 3.2 ä¸ºç¨‹åºæ·»åŠ æƒé™



**ç½‘ç»œç›¸å…³æƒé™è®¾ç½®**ï¼š
```bash
# ç»™ç¨‹åºæ·»åŠ ç»‘å®šç‰¹æƒç«¯å£æƒé™

$ sudo setcap cap_net_bind_service+ep /path/to/program

# æ·»åŠ ç½‘ç»œç®¡ç†æƒé™

$ sudo setcap cap_net_admin+ep /usr/local/bin/myapp

# æ·»åŠ åŸå§‹å¥—æ¥å­—æƒé™

$ sudo setcap cap_net_raw+ep /usr/local/bin/network_tool
```

**æ–‡ä»¶ç³»ç»Ÿæƒé™è®¾ç½®**ï¼š
```bash
# æ·»åŠ æ–‡ä»¶æ‰€æœ‰è€…ç»•è¿‡æƒé™

$ sudo setcap cap_fowner+ep /usr/local/bin/file_manager

# æ·»åŠ DACè¦†ç›–æƒé™

$ sudo setcap cap_dac_override+ep /usr/local/bin/backup_tool
```

### 3.3 ç»„åˆå¤šä¸ªæƒé™



**è®¾ç½®å¤šä¸ªæƒé™**ï¼š
```bash
# åŒæ—¶è®¾ç½®å¤šä¸ªç½‘ç»œæƒé™

$ sudo setcap cap_net_admin,cap_net_raw+ep /usr/local/bin/network_analyzer

# è®¾ç½®æ–‡ä»¶å’Œç½‘ç»œæƒé™

$ sudo setcap cap_dac_override,cap_net_bind_service+ep /usr/local/bin/web_server
```

### 3.4 ç§»é™¤ç¨‹åºæƒé™



**ç§»é™¤æ‰€æœ‰capabilities**ï¼š
```bash
# å®Œå…¨ç§»é™¤ç¨‹åºçš„capabilities

$ sudo setcap -r /path/to/program

# éªŒè¯ç§»é™¤ç»“æœ

$ getcap /path/to/program
# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜ç§»é™¤æˆåŠŸ

```

### 3.5 å®é™…åº”ç”¨æ¡ˆä¾‹



**æ¡ˆä¾‹1ï¼šè®©æ™®é€šç”¨æˆ·è¿è¡Œç½‘ç»œæœåŠ¡**
```bash
# ç¼–è¯‘ä¸€ä¸ªç›‘å¬80ç«¯å£çš„ç¨‹åº

$ gcc -o my_web_server web_server.c

# è®¾ç½®ç»‘å®šç‰¹æƒç«¯å£æƒé™

$ sudo setcap cap_net_bind_service+ep my_web_server

# ç°åœ¨æ™®é€šç”¨æˆ·å¯ä»¥è¿è¡Œç›‘å¬80ç«¯å£

$ ./my_web_server  # æˆåŠŸç»‘å®š80ç«¯å£
```

**æ¡ˆä¾‹2ï¼šè®©ç¨‹åºå…·æœ‰ç½‘ç»œæŠ“åŒ…èƒ½åŠ›**
```bash
# ç»™è‡ªå®šä¹‰æŠ“åŒ…å·¥å…·è®¾ç½®æƒé™

$ sudo setcap cap_net_raw,cap_net_admin+ep packet_capture

# éªŒè¯æƒé™è®¾ç½®

$ getcap packet_capture
packet_capture = cap_net_admin,cap_net_raw+ep
```

---

## 4. ğŸ“ æ–‡ä»¶Capabilities vs è¿›ç¨‹Capabilities



### 4.1 ä¸¤ç§Capabilitiesçš„åŒºåˆ«



**æ¦‚å¿µå¯¹æ¯”**ï¼š

| ç±»å‹ | **å­˜å‚¨ä½ç½®** | **ç”Ÿæ•ˆæ—¶æœº** | **æŒä¹…æ€§** | **å½±å“èŒƒå›´** |
|------|------------|-------------|-----------|-------------|
| ğŸ—‚ï¸ **æ–‡ä»¶Capabilities** | `æ–‡ä»¶æ‰©å±•å±æ€§` | `ç¨‹åºå¯åŠ¨æ—¶` | `æŒä¹…ä¿å­˜` | `è¯¥ç¨‹åºæ‰€æœ‰å®ä¾‹` |
| ğŸ”„ **è¿›ç¨‹Capabilities** | `è¿›ç¨‹å†…å­˜ç©ºé—´` | `è¿›ç¨‹è¿è¡ŒæœŸ` | `è¿›ç¨‹ç»“æŸæ¶ˆå¤±` | `å½“å‰è¿›ç¨‹å®ä¾‹` |

### 4.2 æ–‡ä»¶Capabilitiesè¯¦è§£



**å­˜å‚¨æœºåˆ¶**ï¼š
```
æ–‡ä»¶æƒé™å­˜å‚¨ï¼š
ç¨‹åºæ–‡ä»¶
â”œâ”€â”€ ä¼ ç»Ÿæ–‡ä»¶å±æ€§(rwxæƒé™)
â””â”€â”€ æ‰©å±•å±æ€§(Extended Attributes)
    â””â”€â”€ security.capability â† Capabilitieså­˜å‚¨åœ¨è¿™é‡Œ
```

**æŸ¥çœ‹æ–‡ä»¶æ‰©å±•å±æ€§**ï¼š
```bash
# æŸ¥çœ‹æ–‡ä»¶çš„æ‰€æœ‰æ‰©å±•å±æ€§

$ getfattr -d /bin/ping

# ä¸“é—¨æŸ¥çœ‹capabilitieså±æ€§

$ getfattr -n security.capability /bin/ping
```

### 4.3 è¿›ç¨‹Capabilitiesè¯¦è§£



**è¿›ç¨‹æƒé™çŠ¶æ€**ï¼š
```
è¿›ç¨‹è¿è¡Œæ—¶æƒé™ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿›ç¨‹å†…å­˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Effective Set   â”‚ â† å½“å‰æœ‰æ•ˆæƒé™
â”‚ Permitted Set   â”‚ â† å…è®¸æ¿€æ´»çš„æƒé™
â”‚ Inheritable Set â”‚ â† å¯ä¼ é€’ç»™å­è¿›ç¨‹
â”‚ Bounding Set    â”‚ â† æƒé™ä¸Šç•Œ
â”‚ Ambient Set     â”‚ â† ç¯å¢ƒæƒé™(æ–°å¢)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠ¨æ€æŸ¥çœ‹è¿›ç¨‹æƒé™**ï¼š
```bash
# æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„æƒé™

$ cat /proc/1234/status | grep Cap

# æŸ¥çœ‹æ‰€æœ‰pingè¿›ç¨‹çš„æƒé™

$ ps aux | grep ping
$ cat /proc/$(pgrep ping)/status | grep Cap
```

### 4.4 æƒé™ä¼ é€’æœºåˆ¶



**ä»æ–‡ä»¶åˆ°è¿›ç¨‹çš„ä¼ é€’**ï¼š
```
ç¨‹åºå¯åŠ¨è¿‡ç¨‹ï¼š
æ–‡ä»¶Capabilities â†’ è®¡ç®— â†’ è¿›ç¨‹Capabilities

è®¡ç®—å…¬å¼ï¼š
P'(permitted) = (P(inheritable) & F(inheritable)) |
                (F(permitted) & cap_bset)

P'(effective) = F(effective) ? P'(permitted) : 0

P'(inheritable) = P(inheritable)
```

**å®é™…ä¼ é€’ç¤ºä¾‹**ï¼š
```bash
# æŸ¥çœ‹ç¨‹åºæ–‡ä»¶æƒé™

$ getcap /usr/sbin/tcpdump
/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip

# è¿è¡Œç¨‹åºåæŸ¥çœ‹è¿›ç¨‹æƒé™

$ sudo tcpdump -i eth0 &
$ cat /proc/$(pgrep tcpdump)/status | grep Cap
# å¯ä»¥çœ‹åˆ°æ–‡ä»¶æƒé™å·²è½¬æ¢ä¸ºè¿›ç¨‹æƒé™

```

### 4.5 æƒé™çš„åŠ¨æ€å˜åŒ–



**ç¨‹åºè¿è¡Œä¸­çš„æƒé™å˜åŒ–**ï¼š
- **æƒé™æå‡**ï¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¿€æ´»permittedä¸­çš„æƒé™åˆ°effective
- **æƒé™é™çº§**ï¼šä¸»åŠ¨æ”¾å¼ƒæŸäº›effectiveæƒé™
- **æƒé™ä¼ é€’**ï¼šforkæ—¶å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹çš„inheritableæƒé™

**ç›‘æ§æƒé™å˜åŒ–**ï¼š
```bash
# ä½¿ç”¨straceç›‘æ§æƒé™ç³»ç»Ÿè°ƒç”¨

$ strace -e capget,capset your_program

# ç›‘æ§capabilitiesç›¸å…³çš„å®¡è®¡æ—¥å¿—

$ sudo ausearch -m CAPSET
```

---

## 5. ğŸ› ï¸ å¸¸ç”¨Capabilitiesæƒé™è¯´æ˜



### 5.1 ç½‘ç»œç›¸å…³æƒé™



**CAP_NET_BIND_SERVICE**
```
æƒé™å«ä¹‰ï¼šç»‘å®šç‰¹æƒç«¯å£ï¼ˆ<1024ï¼‰
åº”ç”¨åœºæ™¯ï¼šWebæœåŠ¡å™¨ã€é‚®ä»¶æœåŠ¡å™¨ç­‰éœ€è¦ç›‘å¬æ ‡å‡†ç«¯å£çš„æœåŠ¡
å®‰å…¨é£é™©ï¼šä½ï¼Œåªå½±å“ç«¯å£ç»‘å®š
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# HTTPæœåŠ¡å™¨ç»‘å®š80ç«¯å£

$ sudo setcap cap_net_bind_service+ep nginx
```

**CAP_NET_RAW**
```
æƒé™å«ä¹‰ï¼šåˆ›å»ºåŸå§‹å¥—æ¥å­—ï¼Œå‘é€åŸå§‹ç½‘ç»œåŒ…
åº”ç”¨åœºæ™¯ï¼špingã€tracerouteã€ç½‘ç»œæ‰«æå·¥å…·
å®‰å…¨é£é™©ï¼šä¸­ç­‰ï¼Œå¯èƒ½è¢«ç”¨äºç½‘ç»œæ”»å‡»
```

**CAP_NET_ADMIN**
```
æƒé™å«ä¹‰ï¼šç½‘ç»œç®¡ç†æ“ä½œï¼ˆé…ç½®ç½‘ç»œæ¥å£ã€è·¯ç”±è¡¨ç­‰ï¼‰
åº”ç”¨åœºæ™¯ï¼šç½‘ç»œé…ç½®å·¥å…·ã€VPNè½¯ä»¶ã€ç½‘ç»œç›‘æ§
å®‰å…¨é£é™©ï¼šé«˜ï¼Œå¯ä»¥ä¿®æ”¹ç½‘ç»œé…ç½®
```

### 5.2 æ–‡ä»¶ç³»ç»Ÿç›¸å…³æƒé™



**CAP_DAC_OVERRIDE**
```
æƒé™å«ä¹‰ï¼šç»•è¿‡æ–‡ä»¶çš„è¯»ã€å†™ã€æ‰§è¡Œæƒé™æ£€æŸ¥
åº”ç”¨åœºæ™¯ï¼šç³»ç»Ÿå¤‡ä»½å·¥å…·ã€æ–‡ä»¶æ¢å¤è½¯ä»¶
å®‰å…¨é£é™©ï¼šæé«˜ï¼Œå¯ä»¥è®¿é—®ä»»æ„æ–‡ä»¶
```

**æƒé™æ•ˆæœæ¼”ç¤º**ï¼š
```bash
# æ™®é€šç”¨æˆ·æ— æ³•è®¿é—®çš„æ–‡ä»¶

$ cat /etc/shadow
cat: /etc/shadow: Permission denied

# ç»™ç¨‹åºè®¾ç½®æƒé™å

$ sudo setcap cap_dac_override+ep my_backup_tool
$ ./my_backup_tool /etc/shadow  # ç°åœ¨å¯ä»¥è®¿é—®äº†
```

**CAP_FOWNER**
```
æƒé™å«ä¹‰ï¼šç»•è¿‡æ–‡ä»¶æ‰€æœ‰è€…æƒé™æ£€æŸ¥ï¼Œå¯ä»¥ä¿®æ”¹ä¸å±äºè‡ªå·±çš„æ–‡ä»¶
åº”ç”¨åœºæ™¯ï¼šæ–‡ä»¶ç®¡ç†å™¨ã€ç³»ç»Ÿç»´æŠ¤å·¥å…·
å®‰å…¨é£é™©ï¼šé«˜ï¼Œå¯èƒ½ç ´åæ–‡ä»¶æ‰€æœ‰æƒ
```

### 5.3 ç³»ç»Ÿç®¡ç†ç›¸å…³æƒé™



**CAP_SYS_ADMIN**
```
æƒé™å«ä¹‰ï¼šç³»ç»Ÿç®¡ç†å¤§æ‚çƒ©æƒé™ï¼ˆåŒ…å«å¾ˆå¤šå­æƒé™ï¼‰
åº”ç”¨åœºæ™¯ï¼šå®¹å™¨è¿è¡Œæ—¶ã€è™šæ‹ŸåŒ–è½¯ä»¶ã€ç³»ç»Ÿç›‘æ§
å®‰å…¨é£é™©ï¼šæé«˜ï¼Œå‡ ä¹ç­‰åŒäºrootæƒé™
```

> âš ï¸ **é‡è¦æé†’**ï¼š`CAP_SYS_ADMIN`æƒé™è¿‡äºå®½æ³›ï¼Œå°½é‡é¿å…ä½¿ç”¨ï¼Œä¼˜å…ˆè€ƒè™‘æ›´å…·ä½“çš„æƒé™ã€‚

**CAP_SYS_TIME**
```
æƒé™å«ä¹‰ï¼šä¿®æ”¹ç³»ç»Ÿæ—¶é—´å’Œç¡¬ä»¶æ—¶é’Ÿ
åº”ç”¨åœºæ™¯ï¼šæ—¶é—´åŒæ­¥æœåŠ¡ï¼ˆNTPï¼‰ã€ç³»ç»Ÿæ—¶é—´å·¥å…·
å®‰å…¨é£é™©ï¼šä¸­ç­‰ï¼Œå¯èƒ½å½±å“æ—¥å¿—å’Œè¯ä¹¦æœ‰æ•ˆæ€§
```

### 5.4 è¿›ç¨‹ç›¸å…³æƒé™



**CAP_KILL**
```
æƒé™å«ä¹‰ï¼šå‘ä»»æ„è¿›ç¨‹å‘é€ä¿¡å·ï¼ˆåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹ï¼‰
åº”ç”¨åœºæ™¯ï¼šè¿›ç¨‹ç®¡ç†å·¥å…·ã€ç³»ç»Ÿç›‘æ§è½¯ä»¶
å®‰å…¨é£é™©ï¼šä¸­ç­‰ï¼Œå¯èƒ½å¹²æ‰°å…¶ä»–ç”¨æˆ·è¿›ç¨‹
```

**CAP_SETUID / CAP_SETGID**
```
æƒé™å«ä¹‰ï¼šä»»æ„è®¾ç½®è¿›ç¨‹çš„ç”¨æˆ·ID/ç»„ID
åº”ç”¨åœºæ™¯ï¼šèº«ä»½åˆ‡æ¢å·¥å…·ã€ç‰¹æƒé™çº§ç¨‹åº
å®‰å…¨é£é™©ï¼šæé«˜ï¼Œå¯ä»¥å†’å……ä»»æ„ç”¨æˆ·
```

### 5.5 æƒé™é£é™©ç­‰çº§è¯„ä¼°



**é£é™©ç­‰çº§åˆ†ç±»**ï¼š

| é£é™©ç­‰çº§ | **æƒé™ç¤ºä¾‹** | **å®‰å…¨å»ºè®®** |
|---------|-------------|-------------|
| ğŸŸ¢ **ä½é£é™©** | `CAP_NET_BIND_SERVICE` | `ç›¸å¯¹å®‰å…¨ï¼Œå¯æ”¾å¿ƒä½¿ç”¨` |
| ğŸŸ¡ **ä¸­ç­‰é£é™©** | `CAP_NET_RAW, CAP_KILL` | `è°¨æ…ä½¿ç”¨ï¼Œé™åˆ¶åº”ç”¨åœºæ™¯` |
| ğŸ”´ **é«˜é£é™©** | `CAP_DAC_OVERRIDE, CAP_FOWNER` | `ä¸¥æ ¼æ§åˆ¶ï¼Œå®šæœŸå®¡è®¡` |
| ğŸš¨ **æé«˜é£é™©** | `CAP_SYS_ADMIN, CAP_SETUID` | `é¿å…ä½¿ç”¨ï¼Œå¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆ` |

---

## 6. ğŸ”’ Capabilitieså®‰å…¨ä¼˜åŠ¿



### 6.1 æœ€å°æƒé™åŸåˆ™å®ç°



**ä¼ ç»Ÿvs Capabilitieså¯¹æ¯”**ï¼š
```
ä¼ ç»Ÿæ–¹å¼è¿è¡Œç½‘ç»œæœåŠ¡ï¼š
ç”¨æˆ·æƒé™ï¼šroot (UID=0)
æœ‰æ•ˆæƒé™ï¼šALL (å…¨éƒ¨ç³»ç»Ÿæƒé™)
å®‰å…¨é£é™©ï¼šæœåŠ¡è¢«æ”»ç ´ = æ•´ä¸ªç³»ç»Ÿè¢«æ§åˆ¶

Capabilitiesæ–¹å¼ï¼š
ç”¨æˆ·æƒé™ï¼šnobody (UID=65534)  
æœ‰æ•ˆæƒé™ï¼šcap_net_bind_service (ä»…ç«¯å£ç»‘å®š)
å®‰å…¨é£é™©ï¼šæœåŠ¡è¢«æ”»ç ´ = åªèƒ½ç»‘å®šç«¯å£ï¼Œæ— å…¶ä»–å±å®³
```

### 6.2 æƒé™éš”ç¦»ä¼˜åŠ¿



**è¿›ç¨‹æƒé™éš”ç¦»**ï¼š
```
å¤šæœåŠ¡ç³»ç»Ÿæƒé™éš”ç¦»ï¼š

WebæœåŠ¡å™¨è¿›ç¨‹ï¼š
â”œâ”€â”€ ç”¨æˆ·ï¼šwww-data
â”œâ”€â”€ æƒé™ï¼šcap_net_bind_service
â””â”€â”€ é£é™©ï¼šä»…èƒ½ç»‘å®š80/443ç«¯å£

æ•°æ®åº“è¿›ç¨‹ï¼š
â”œâ”€â”€ ç”¨æˆ·ï¼šmysql  
â”œâ”€â”€ æƒé™ï¼šcap_dac_override (è®¿é—®æ•°æ®æ–‡ä»¶)
â””â”€â”€ é£é™©ï¼šä»…èƒ½è®¿é—®æ•°æ®æ–‡ä»¶

å¤‡ä»½è¿›ç¨‹ï¼š
â”œâ”€â”€ ç”¨æˆ·ï¼šbackup
â”œâ”€â”€ æƒé™ï¼šcap_dac_override + cap_dac_read_search
â””â”€â”€ é£é™©ï¼šåªèƒ½è¯»å–æ–‡ä»¶ç”¨äºå¤‡ä»½
```

### 6.3 å®¹å™¨å®‰å…¨å¢å¼º



**å®¹å™¨è¿è¡Œæ—¶æƒé™æ§åˆ¶**ï¼š
```bash
# Dockerä¸­ç²¾ç¡®æ§åˆ¶å®¹å™¨æƒé™

$ docker run --cap-drop=ALL \
             --cap-add=NET_BIND_SERVICE \
             nginx:latest

# Kubernetesä¸­çš„SecurityContext

apiVersion: v1
kind: Pod
spec:
  securityContext:
    capabilities:
      drop:
      - ALL
      add:
      - NET_BIND_SERVICE
```

### 6.4 æ”»å‡»é¢å‡å°‘



**å®‰å…¨é˜²æŠ¤æ•ˆæœ**ï¼š

| æ”»å‡»ç±»å‹ | **ä¼ ç»Ÿrootæƒé™** | **Capabilitiesæƒé™** |
|---------|----------------|---------------------|
| ğŸ”“ **ææƒæ”»å‡»** | `æ˜“æˆåŠŸï¼Œè·å¾—å…¨éƒ¨æƒé™` | `å—é™ï¼Œåªèƒ½è·å¾—ç‰¹å®šæƒé™` |
| ğŸ’£ **ç³»ç»Ÿç ´å** | `å¯ä»¥åˆ é™¤ç³»ç»Ÿæ–‡ä»¶` | `æƒé™ä¸è¶³ï¼Œæ— æ³•ç ´å` |
| ğŸ•µï¸ **ä¿¡æ¯æ³„éœ²** | `å¯ä»¥è¯»å–æ‰€æœ‰æ•æ„Ÿæ–‡ä»¶` | `ä»…èƒ½è¯»å–æˆæƒèŒƒå›´å†…æ–‡ä»¶` |
| ğŸŒ **æ¨ªå‘æ¸—é€** | `å¯ä»¥æ”»å‡»å…¶ä»–æœåŠ¡` | `æƒé™éš”ç¦»ï¼Œéš¾ä»¥æ‰©æ•£` |

### 6.5 å®¡è®¡ä¸ç›‘æ§ä¼˜åŠ¿



**æƒé™ä½¿ç”¨è¿½è¸ª**ï¼š
```bash
# å®¡è®¡capabilitiesä½¿ç”¨æƒ…å†µ

$ sudo auditctl -a always,exit -F arch=b64 -S capset

# æŸ¥çœ‹æƒé™å˜æ›´æ—¥å¿—

$ sudo ausearch -m CAPSET -ts recent
```

**å¼‚å¸¸æ£€æµ‹**ï¼š
- **æƒé™å¼‚å¸¸**ï¼šè¿›ç¨‹è·å¾—äº†ä¸åº”è¯¥æ‹¥æœ‰çš„æƒé™
- **æƒé™æ»¥ç”¨**ï¼šç¨‹åºä½¿ç”¨è¶…å‡ºé¢„æœŸèŒƒå›´çš„æƒé™
- **æƒé™æå‡**ï¼šæ£€æµ‹åˆ°å¼‚å¸¸çš„æƒé™æå‡è¡Œä¸º

---

## 7. ğŸ”§ Capabilitiesæ•…éšœæ’æŸ¥



### 7.1 å¸¸è§æƒé™é—®é¢˜



**é—®é¢˜1ï¼šç¨‹åºæ— æ³•å¯åŠ¨**
```bash
# ç—‡çŠ¶ï¼šç¨‹åºå¯åŠ¨å¤±è´¥ï¼Œæç¤ºæƒé™ä¸è¶³

$ ./my_server
bind: Permission denied

# æ’æŸ¥æ­¥éª¤

$ getcap ./my_server
# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜ç¼ºå°‘capabilities


# è§£å†³æ–¹æ³•

$ sudo setcap cap_net_bind_service+ep ./my_server
```

**é—®é¢˜2ï¼šæƒé™è®¾ç½®åä»ç„¶æ— æ•ˆ**
```bash
# æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§

$ ls -l /path/to/program
$ getcap /path/to/program

# æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æ”¯æŒæ‰©å±•å±æ€§

$ mount | grep "$(df /path/to/program | tail -1 | awk '{print $1}')"
# ç¡®ä¿æœ‰user_xattræŒ‚è½½é€‰é¡¹

```

### 7.2 æƒé™è°ƒè¯•å·¥å…·



**ä½¿ç”¨straceè°ƒè¯•**ï¼š
```bash
# è·Ÿè¸ªæƒé™ç›¸å…³ç³»ç»Ÿè°ƒç”¨

$ strace -e capget,capset,setresuid,setresgid your_program

# è·Ÿè¸ªæ–‡ä»¶è®¿é—®æƒé™

$ strace -e openat,access your_program 2>&1 | grep -E "(EPERM|EACCES)"
```

**ä½¿ç”¨capshæµ‹è¯•æƒé™**ï¼š
```bash
# æµ‹è¯•ç‰¹å®šæƒé™æ˜¯å¦ç”Ÿæ•ˆ

$ sudo capsh --caps="cap_net_bind_service+epi" --user=nobody -- -c "your_program"

# æŸ¥çœ‹å½“å‰shellçš„æƒé™

$ capsh --print
```

### 7.3 æ–‡ä»¶ç³»ç»Ÿå…¼å®¹æ€§é—®é¢˜



**ä¸æ”¯æŒcapabilitiesçš„æ–‡ä»¶ç³»ç»Ÿ**ï¼š
```bash
# æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿç±»å‹

$ df -T /path/to/program

# å¸¸è§ä¸æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿ

- FAT32/VFATï¼šä¸æ”¯æŒæ‰©å±•å±æ€§
- NFS (éƒ¨åˆ†ç‰ˆæœ¬)ï¼šå¯èƒ½ä¸æ”¯æŒ
- tmpfsï¼šæ”¯æŒï¼Œä½†é‡å¯åä¸¢å¤±
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ1ï¼šé‡æ–°æŒ‚è½½å¯ç”¨æ‰©å±•å±æ€§

$ sudo mount -o remount,user_xattr /dev/sdb1 /mount/point

# æ–¹æ¡ˆ2ï¼šå¤åˆ¶åˆ°æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿ

$ cp program /usr/local/bin/
$ sudo setcap cap_net_bind_service+ep /usr/local/bin/program
```

### 7.4 SELinuxå…¼å®¹æ€§



**SELinuxç¯å¢ƒä¸‹çš„é—®é¢˜**ï¼š
```bash
# æ£€æŸ¥SELinuxçŠ¶æ€

$ getenforce

# æŸ¥çœ‹SELinuxé˜»æ­¢çš„æ“ä½œ

$ sudo ausearch -m AVC -ts recent

# ä¸´æ—¶å…³é—­SELinuxæµ‹è¯•

$ sudo setenforce 0
```

### 7.5 æƒé™ä¸¢å¤±é—®é¢˜



**æ–‡ä»¶ä¿®æ”¹å¯¼è‡´æƒé™ä¸¢å¤±**ï¼š
```bash
# ç¼–è¾‘ç¨‹åºåcapabilitiesæ¶ˆå¤±

$ vim my_program  # ä¿®æ”¹æ–‡ä»¶
$ getcap my_program  # æƒé™æ¶ˆå¤±äº†ï¼

# åŸå› ï¼šæ–‡ä»¶ä¿®æ”¹ä¼šæ¸…é™¤æ‰©å±•å±æ€§

# è§£å†³ï¼šé‡æ–°è®¾ç½®æƒé™

$ sudo setcap cap_net_bind_service+ep my_program
```

**æ‰¹é‡æ¢å¤æƒé™è„šæœ¬**ï¼š
```bash
#!/bin/bash

# restore_capabilities.sh


# å®šä¹‰ç¨‹åºåŠå…¶éœ€è¦çš„æƒé™

declare -A PROGRAMS
PROGRAMS["/usr/local/bin/web_server"]="cap_net_bind_service+ep"
PROGRAMS["/usr/local/bin/network_tool"]="cap_net_raw+ep"

# æ‰¹é‡æ¢å¤æƒé™

for program in "${!PROGRAMS[@]}"; do
    if [[ -f "$program" ]]; then
        sudo setcap "${PROGRAMS[$program]}" "$program"
        echo "Restored capabilities for $program"
    fi
done
```

---

## 8. âœ… Capabilitiesæœ€ä½³å®è·µ



### 8.1 æƒé™è®¾è®¡åŸåˆ™



**æœ€å°æƒé™åŸåˆ™**ï¼š
```
æƒé™è®¾è®¡æ€è·¯ï¼š
1. åˆ†æç¨‹åºçœŸæ­£éœ€è¦çš„åŠŸèƒ½
2. æ‰¾åˆ°å¯¹åº”çš„æœ€å°capabilities
3. é¿å…ä½¿ç”¨è¿‡äºå®½æ³›çš„æƒé™
4. å®šæœŸå®¡æŸ¥å’Œæ¸…ç†ä¸å¿…è¦çš„æƒé™
```

**æƒé™ç»„åˆç­–ç•¥**ï¼š
```bash
# ğŸš« ä¸æ¨èï¼šä½¿ç”¨è¿‡äºå®½æ³›çš„æƒé™

$ sudo setcap cap_sys_admin+ep my_program

# âœ… æ¨èï¼šä½¿ç”¨ç²¾ç¡®çš„æƒé™ç»„åˆ

$ sudo setcap cap_net_bind_service,cap_dac_read_search+ep my_program
```

### 8.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²



**éƒ¨ç½²å‰æƒé™è§„åˆ’**ï¼š
```
éƒ¨ç½²æµç¨‹ï¼š
1. å¼€å‘ç¯å¢ƒæµ‹è¯•æœ€å°æƒé™é›†
2. é¢„ç”Ÿäº§ç¯å¢ƒéªŒè¯æƒé™æœ‰æ•ˆæ€§
3. ç”Ÿäº§ç¯å¢ƒæƒé™è‡ªåŠ¨åŒ–è®¾ç½®
4. æƒé™ä½¿ç”¨æƒ…å†µç›‘æ§
```

**è‡ªåŠ¨åŒ–æƒé™ç®¡ç†**ï¼š
```bash
#!/bin/bash

# deploy_with_capabilities.sh


PROGRAM="/usr/local/bin/my_app"
CAPABILITIES="cap_net_bind_service+ep"

# éƒ¨ç½²ç¨‹åº

cp my_app "$PROGRAM"

# è®¾ç½®æƒé™

sudo setcap "$CAPABILITIES" "$PROGRAM"

# éªŒè¯æƒé™

if getcap "$PROGRAM" | grep -q "$CAPABILITIES"; then
    echo "âœ… Capabilities set successfully"
else
    echo "âŒ Failed to set capabilities"
    exit 1
fi
```

### 8.3 å®‰å…¨ç›‘æ§ç­–ç•¥



**æƒé™ä½¿ç”¨ç›‘æ§**ï¼š
```bash
# å¯ç”¨capabilitieså®¡è®¡

echo "-a always,exit -F arch=b64 -S capset -k capability_use" >> /etc/audit/rules.d/capabilities.rules

# å®šæœŸæ£€æŸ¥å¼‚å¸¸æƒé™ä½¿ç”¨

sudo ausearch -k capability_use -ts today
```

**æƒé™æ¸…å•ç®¡ç†**ï¼š
```bash
#!/bin/bash

# audit_capabilities.sh


echo "=== System Capabilities Audit ==="
echo "Date: $(date)"
echo

# æ‰«æç³»ç»Ÿä¸­æ‰€æœ‰è®¾ç½®äº†capabilitiesçš„æ–‡ä»¶

echo "Files with capabilities:"
sudo getcap -r / 2>/dev/null | while read line; do
    echo "  $line"
done

echo
echo "Running processes with special capabilities:"
# æ£€æŸ¥è¿è¡Œä¸­è¿›ç¨‹çš„æƒé™

for pid in $(ps -eo pid --no-headers); do
    if [[ -r "/proc/$pid/status" ]]; then
        caps=$(grep "^CapEff:" "/proc/$pid/status" | awk '{print $2}')
        if [[ "$caps" != "0000000000000000" ]]; then
            cmd=$(ps -p "$pid" -o comm --no-headers 2>/dev/null)
            echo "  PID $pid ($cmd): $caps"
        fi
    fi
done
```

### 8.4 å®¹å™¨ç¯å¢ƒæœ€ä½³å®è·µ



**Dockerå®¹å™¨æƒé™æ§åˆ¶**ï¼š
```yaml
# docker-compose.yml

version: '3.8'
services:
  web:
    image: nginx:latest
    cap_drop:
      - ALL          # ç§»é™¤æ‰€æœ‰é»˜è®¤æƒé™
    cap_add:
      - NET_BIND_SERVICE  # åªæ·»åŠ å¿…éœ€æƒé™
    security_opt:
      - no-new-privileges:true  # ç¦æ­¢æƒé™æå‡
```

**Kubernetes SecurityContext**ï¼š
```yaml
apiVersion: v1
kind: Pod
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
  containers:
  - name: app
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - ALL
        add:
        - NET_BIND_SERVICE
```

### 8.5 å¼€å‘é˜¶æ®µæœ€ä½³å®è·µ



**å¼€å‘ç¯å¢ƒæƒé™æµ‹è¯•**ï¼š
```bash
# æµ‹è¯•è„šæœ¬ï¼šéªŒè¯æœ€å°æƒé™é›†

#!/bin/bash

test_minimal_caps() {
    local program="$1"
    local caps="$2"
    
#    # è®¾ç½®æµ‹è¯•æƒé™
    sudo setcap "$caps" "$program"
    
#    # ä»¥éç‰¹æƒç”¨æˆ·è¿è¡Œæµ‹è¯•
    if sudo -u nobody "$program" --test; then
        echo "âœ… $caps is sufficient for $program"
        return 0
    else
        echo "âŒ $caps is not sufficient for $program"
        return 1
    fi
}

# é€æ­¥æµ‹è¯•æƒé™

test_minimal_caps "./my_server" "cap_net_bind_service+ep"
```

**æ–‡æ¡£åŒ–æƒé™éœ€æ±‚**ï¼š
```markdown
# ç¨‹åºæƒé™éœ€æ±‚æ–‡æ¡£


# my_web_server


- **éœ€è¦æƒé™**: cap_net_bind_service+ep
- **æƒé™åŸå› **: ç»‘å®š80/443ç«¯å£æä¾›HTTP/HTTPSæœåŠ¡
- **å®‰å…¨é£é™©**: ä½é£é™©ï¼Œä»…å½±å“ç«¯å£ç»‘å®š
- **æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨åå‘ä»£ç†æˆ–è¿è¡Œåœ¨é«˜ç«¯å£

# my_backup_tool  


- **éœ€è¦æƒé™**: cap_dac_read_search+ep
- **æƒé™åŸå› **: è¯»å–ç³»ç»Ÿæ–‡ä»¶è¿›è¡Œå¤‡ä»½
- **å®‰å…¨é£é™©**: ä¸­ç­‰é£é™©ï¼Œå¯è¯»å–æ•æ„Ÿæ–‡ä»¶
- **æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨ä¸“ç”¨å¤‡ä»½ç”¨æˆ·å’Œsudoè§„åˆ™
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ Capabilitiesæœ¬è´¨ï¼šå°†rootæƒé™ç»†åˆ†ä¸ºç‹¬ç«‹çš„èƒ½åŠ›å•å…ƒ
ğŸ”¸ ä¸‰ç§çŠ¶æ€ï¼šæœ‰æ•ˆ(e)ã€å…è®¸(p)ã€ç»§æ‰¿(i)æƒé™çŠ¶æ€
ğŸ”¸ ä¸¤ç§å­˜å‚¨ï¼šæ–‡ä»¶capabilities vs è¿›ç¨‹capabilities
ğŸ”¸ å…³é”®å‘½ä»¤ï¼šgetcapæŸ¥çœ‹æƒé™ï¼Œsetcapè®¾ç½®æƒé™
ğŸ”¸ å®‰å…¨åŸåˆ™ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œé¿å…è¿‡åº¦æˆæƒ
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¸ºä»€ä¹ˆä½¿ç”¨Capabilities**
```
ä¼ ç»Ÿé—®é¢˜ï¼š
- rootæƒé™è¿‡å¤§ï¼Œå®‰å…¨é£é™©é«˜
- æ™®é€šç”¨æˆ·æƒé™ä¸è¶³ï¼ŒåŠŸèƒ½å—é™

Capabilitiesä¼˜åŠ¿ï¼š
- ç²¾ç¡®æƒé™æ§åˆ¶ï¼ŒæŒ‰éœ€åˆ†é…
- é™ä½å®‰å…¨é£é™©ï¼Œæƒé™éš”ç¦»
- æ”¯æŒå®¹å™¨åŒ–ï¼Œé€‚åˆç°ä»£æ¶æ„
```

**ğŸ”¹ æƒé™çŠ¶æ€çš„ä½œç”¨**
```
ç†è§£è¦ç‚¹ï¼š
- Effectiveï¼šå½“å‰çœŸæ­£ç”Ÿæ•ˆçš„æƒé™
- Permittedï¼šç¨‹åºè¢«å…è®¸æ¿€æ´»çš„æƒé™ä¸Šç•Œ
- Inheritableï¼šå¯ä»¥ä¼ é€’ç»™å­è¿›ç¨‹çš„æƒé™
- æƒé™å¯ä»¥åœ¨è¿™äº›çŠ¶æ€é—´è½¬æ¢
```

**ğŸ”¹ æ–‡ä»¶vsè¿›ç¨‹æƒé™çš„åŒºåˆ«**
```
å…³é”®å·®å¼‚ï¼š
- æ–‡ä»¶æƒé™ï¼šæŒä¹…åŒ–å­˜å‚¨ï¼Œç¨‹åºå¯åŠ¨æ—¶ç”Ÿæ•ˆ
- è¿›ç¨‹æƒé™ï¼šå†…å­˜ä¸­å­˜å‚¨ï¼Œè¿›ç¨‹è¿è¡ŒæœŸé—´æœ‰æ•ˆ
- ä¼ é€’æœºåˆ¶ï¼šæ–‡ä»¶æƒé™ â†’ è®¡ç®— â†’ è¿›ç¨‹æƒé™
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼



- **ç³»ç»Ÿå®‰å…¨**ï¼šå‡å°‘rootæƒé™ä½¿ç”¨ï¼Œé™ä½æ”»å‡»é¢
- **æœåŠ¡éƒ¨ç½²**ï¼šè®©æ™®é€šç”¨æˆ·è¿è¡Œç³»ç»ŸæœåŠ¡
- **å®¹å™¨å®‰å…¨**ï¼šç²¾ç¡®æ§åˆ¶å®¹å™¨æƒé™ï¼Œæé«˜å®‰å…¨æ€§
- **æƒé™å®¡è®¡**ï¼šç»†ç²’åº¦æƒé™ç›‘æ§å’Œç®¡ç†
- **æ•…éšœæ’æŸ¥**ï¼šå®šä½æƒé™ç›¸å…³é—®é¢˜çš„æ ¹æœ¬åŸå› 

### 9.4 å­¦ä¹ å»ºè®®å’Œæ³¨æ„äº‹é¡¹



**ğŸ”§ å®è·µå»ºè®®**
```
å­¦ä¹ è·¯å¾„ï¼š
1. ä»ç®€å•çš„ç½‘ç»œæƒé™å¼€å§‹(cap_net_bind_service)
2. ç†è§£æƒé™æŸ¥çœ‹å’Œè®¾ç½®çš„åŸºæœ¬æ“ä½œ
3. æŒæ¡æ–‡ä»¶ç³»ç»Ÿç›¸å…³æƒé™çš„ä½¿ç”¨
4. å­¦ä¹ å®¹å™¨ç¯å¢ƒä¸‹çš„æƒé™æ§åˆ¶
5. å»ºç«‹å®Œæ•´çš„æƒé™ç›‘æ§ä½“ç³»
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
é‡è¦æé†’ï¼š
- é¿å…ä½¿ç”¨cap_sys_adminç­‰è¿‡äºå®½æ³›çš„æƒé™
- å®šæœŸå®¡è®¡ç³»ç»Ÿä¸­çš„capabilitiesä½¿ç”¨æƒ…å†µ
- æ–‡ä»¶ä¿®æ”¹ä¼šå¯¼è‡´capabilitiesä¸¢å¤±ï¼Œéœ€è¦é‡æ–°è®¾ç½®
- ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒcapabilities
- SELinuxç¯å¢ƒä¸‹å¯èƒ½éœ€è¦é¢å¤–é…ç½®
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Capabilitiesè®©æƒé™æ§åˆ¶æ›´ç²¾ç¡®ï¼Œå®‰å…¨æ€§æ›´é«˜
- getcapæŸ¥çœ‹æƒé™ï¼Œsetcapè®¾ç½®æƒé™
- æ–‡ä»¶æƒé™æŒä¹…åŒ–ï¼Œè¿›ç¨‹æƒé™åŠ¨æ€åŒ–  
- æœ€å°æƒé™åŸåˆ™æ˜¯å®‰å…¨çš„æ ¹æœ¬
- å®¹å™¨æ—¶ä»£capabilitieså˜å¾—æ›´åŠ é‡è¦