---
title: 31、Ex命令基础操作
---
## 📚 目录

1. [:命令模式进入与使用](#1-命令模式进入与使用)
2. [命令历史记录操作](#2-命令历史记录操作)
3. [命令行编辑快捷键](#3-命令行编辑快捷键)
4. [Tab命令补全功能](#4-tab命令补全功能)
5. [:!外部命令执行](#5-外部命令执行)
6. [:r读取文件内容](#6-r读取文件内容)
7. [:w写入文件选项](#7-w写入文件选项)
8. [命令组合与管道使用](#8-命令组合与管道使用)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 💻 :命令模式进入与使用


### 1.1 什么是Ex命令模式


**🔍 简单理解**：
Ex命令模式就像是vim编辑器的"控制面板"，你可以在这里输入各种指令来操作文件。

```
正常模式 ───按:键──→ Ex命令模式
    ↑                    ↓
    └───按ESC或回车───────┘
```

> 💡 **生活类比**  
> 就像你用遥控器操作电视机一样，按下冒号`:`就是拿起了vim的"遥控器"

### 1.2 如何进入命令模式


**进入步骤**：
1. **在正常模式下**按下 `:` 键
2. 屏幕底部出现冒号提示符
3. 光标移动到命令行
4. 输入命令后按回车执行

```
屏幕显示效果：
┌─────────────────────────┐
│  文件内容显示区域        │
│  hello world           │  
│  这是测试内容           │
│                        │
├─────────────────────────┤
│ :                      │ ← 命令输入区
└─────────────────────────┘
```

### 1.3 常用基础Ex命令


| 命令 | **含义** | **作用说明** |
|------|----------|-------------|
| `:w` | `write` | `保存当前文件` |
| `:q` | `quit` | `退出vim编辑器` |
| `:wq` | `write & quit` | `保存并退出` |
| `:q!` | `force quit` | `强制退出不保存` |

**💡 记忆技巧**：
- `w` = write = 写入保存  
- `q` = quit = 退出
- `!` = 强制执行，不管有没有修改

---

## 2. 📜 命令历史记录操作


### 2.1 历史记录的作用


**🎯 核心功能**：保存你之前输入过的命令，避免重复输入

> 🧠 **记忆关联**  
> 就像手机的通话记录一样，vim会记住你用过的命令

### 2.2 使用上下箭头浏览历史


**操作方法**：
```
在命令模式下（已输入:后）：
↑ 箭头 = 查看上一个命令
↓ 箭头 = 查看下一个命令
```

**实际操作演示**：
```
第一次输入：:w hello.txt
第二次输入：:r test.txt  
第三次输入：:!ls -la

现在按: 然后用↑箭头：
:!ls -la        ← 最近的命令
:r test.txt     ← 再按↑
:w hello.txt    ← 再按↑
```

### 2.3 历史记录的管理


**📋 实用技巧**：
- **快速重执行**：找到历史命令后直接按回车
- **修改后执行**：选中历史命令，编辑后再执行
- **清空输入**：按`Ctrl+U`清空当前命令行

---

## 3. ⌨️ 命令行编辑快捷键


### 3.1 移动光标快捷键


| 快捷键 | **功能** | **使用场景** |
|--------|----------|-------------|
| `Ctrl+A` | `移到行首` | `快速到命令开头修改` |
| `Ctrl+E` | `移到行末` | `快速到命令结尾添加参数` |
| `Ctrl+B` | `向前一个字符` | `精确定位修改位置` |
| `Ctrl+F` | `向后一个字符` | `精确定位修改位置` |

### 3.2 删除和编辑快捷键


**🔧 常用编辑操作**：
```
Ctrl+U  → 删除光标前所有内容
Ctrl+K  → 删除光标后所有内容  
Ctrl+W  → 删除光标前一个单词
Backspace → 删除光标前一个字符
```

**💡 实际应用场景**：
```
输入了错误命令：:w /very/long/wrong/path/file.txt
使用Ctrl+U快速清空，重新输入正确路径
```

### 3.3 编辑技巧组合使用


**🎯 高效编辑流程**：
1. **快速定位**：用Ctrl+A/E移动到需要修改的位置
2. **精确删除**：用Ctrl+W删除单词，用Backspace删除字符
3. **快速重建**：用Ctrl+U清空重来

---

## 4. 🔧 Tab命令补全功能


### 4.1 Tab补全的工作原理


**🔍 简单理解**：Tab键就像智能助手，帮你自动完成命令和文件名

> 📖 **核心概念**  
> Tab补全 = 输入部分内容 + 按Tab键 = 自动补全完整内容

### 4.2 文件名补全


**操作演示**：
```
当前目录有文件：
- hello.txt
- hello_world.txt  
- test.txt

输入：:w hel + Tab键
结果：:w hello    （自动补全共同部分）

再按Tab键显示选项：
hello.txt  hello_world.txt
```

### 4.3 命令补全的类型


**📋 补全范围**：

🔸 **Ex命令补全**：
```
输入：:wr + Tab → :write
输入：:se + Tab → :set
```

🔸 **文件路径补全**：
```
输入：:r /ho + Tab → :r /home/
输入：:w ./te + Tab → :w ./test.txt
```

🔸 **选项补全**：
```
输入：:set nu + Tab → :set number
```

### 4.4 Tab补全的使用技巧


**⭐ 高效使用方法**：
- **连续按Tab**：在多个候选项间循环
- **部分输入**：输入足够区分的字符数量
- **路径导航**：用Tab逐级补全目录路径

```
实用场景：
:w /home/user/documents/very/long/path/
变成：
:w /ho<Tab>/us<Tab>/doc<Tab>/ve<Tab>/lo<Tab>/pa<Tab>/
```

---

## 5. 🚀 :!外部命令执行


### 5.1 什么是外部命令执行


**🎯 核心作用**：在vim中直接运行Linux系统命令，不用退出编辑器

> 💡 **生活类比**  
> 就像在聊天软件中发送文件一样，不用切换到文件管理器

### 5.2 基本语法格式


**📋 命令格式**：
```
:!<Linux命令>
```

**常用示例**：
```bash
:!ls -la          # 查看当前目录文件
:!pwd             # 显示当前路径  
:!date            # 显示当前时间
:!whoami          # 显示当前用户
```

### 5.3 实际应用场景


**🔍 典型使用场景**：

🔸 **文件操作**：
```bash
:!mkdir backup        # 创建备份目录
:!cp file.txt backup/ # 复制文件到备份目录
:!chmod +x script.sh  # 给脚本文件执行权限
```

🔸 **代码编译运行**：
```bash
:!gcc hello.c -o hello    # 编译C程序
:!./hello                 # 运行编译后的程序
:!python3 script.py       # 运行Python脚本
```

🔸 **系统监控**：
```bash
:!free -h            # 查看内存使用情况
:!df -h              # 查看磁盘使用情况  
:!ps aux | grep vim  # 查看vim进程
```

### 5.4 执行结果的处理


**💻 执行流程**：
```
输入命令 → 按回车 → 显示执行结果 → 按任意键返回vim
```

**📋 结果显示格式**：
```
:!ls -la
total 16
drwxr-xr-x  3 user user 4096 Sep 18 14:30 .
drwxr-xr-x 15 user user 4096 Sep 18 14:25 ..
-rw-r--r--  1 user user  135 Sep 18 14:30 hello.txt

Press ENTER or type command to continue
```

---

## 6. 📖 :r读取文件内容


### 6.1 :r命令的作用


**🎯 核心功能**：将其他文件的内容插入到当前文件的光标位置

> 📖 **核心概念**  
> r = read = 读取，就像复制粘贴其他文件的内容

### 6.2 基本使用语法


**📋 命令格式**：
```
:r filename        # 读取指定文件内容
:r !command        # 读取命令执行结果
```

### 6.3 文件内容读取


**💡 实际操作示例**：
```
当前编辑 main.txt：
Line 1: Hello World
Line 2: 光标在这里
Line 3: End of file

执行：:r header.txt

如果 header.txt 内容是：
=== 头部信息 ===
作者：张三
日期：2025-09-18

结果：
Line 1: Hello World  
Line 2: 光标在这里
=== 头部信息 ===     ← 插入的内容
作者：张三
日期：2025-09-18
Line 3: End of file
```

### 6.4 读取命令执行结果


**🔧 命令结果插入**：
```bash
:r !date            # 插入当前时间
:r !ls -la          # 插入目录列表
:r !cat /etc/hosts  # 插入hosts文件内容
```

**实用场景举例**：
```
写文档时插入系统信息：
:r !uname -a        # 插入系统信息
:r !free -h         # 插入内存使用情况
:r !df -h           # 插入磁盘使用情况
```

### 6.5 高级使用技巧


**📍 指定插入位置**：
```
:5r filename        # 在第5行后插入文件内容
:$r filename        # 在文件末尾插入
:0r filename        # 在文件开头插入
```

**⭐ 常用组合操作**：
```bash
# 创建带时间戳的日志条目
:r !echo "=== $(date) ==="
:r !whoami
```

---

## 7. 💾 :w写入文件选项


### 7.1 :w命令详解


**🎯 核心功能**：将编辑器中的内容保存到文件

> 💡 **生活类比**  
> 就像按Ctrl+S保存文档一样，:w是vim的保存功能

### 7.2 基本保存操作


**📋 常用保存格式**：
```bash
:w                  # 保存到当前文件
:w filename         # 另存为指定文件名
:w!                 # 强制保存（覆盖只读等限制）
:w >>filename       # 追加到文件末尾
```

### 7.3 指定范围保存


**🔧 部分内容保存**：
```
:1,10w part.txt     # 保存第1-10行到part.txt
:5,$w tail.txt      # 保存第5行到文件末尾
:.w current.txt     # 保存当前行
```

**💡 实际应用场景**：
```
编辑大文件时提取部分内容：
- 提取配置文件的某个section
- 保存日志文件的特定时间段  
- 分割大文件为小文件
```

### 7.4 高级保存选项


**📊 文件格式和编码**：
```bash
:w ++enc=utf-8 file.txt     # 指定UTF-8编码保存
:w ++ff=unix file.txt       # 指定Unix换行符格式
:w ++bin file.txt           # 二进制格式保存
```

**🔒 权限相关操作**：
```bash
:w !sudo tee %              # 用sudo权限保存当前文件
:w /tmp/backup.txt          # 保存到临时目录
```

### 7.5 保存状态确认


**✅ 保存成功提示**：
```
"filename.txt" 15L, 234C written
# 含义：文件名 | 行数 | 字符数 | 写入状态
```

**❌ 保存失败处理**：
```
常见错误：
- 权限不足：使用:w !sudo tee %
- 磁盘空间不足：清理磁盘或选择其他位置
- 文件被锁定：检查其他程序是否正在使用
```

---

## 8. 🔄 命令组合与管道使用


### 8.1 什么是命令组合


**🔍 简单理解**：将多个命令连接起来，让一个命令的输出成为另一个命令的输入

> 💡 **生活类比**  
> 就像工厂流水线一样，上一道工序的产品成为下一道工序的原料

### 8.2 管道操作符详解


**📋 基本管道语法**：
```bash
命令1 | 命令2 | 命令3
```

**常用管道组合**：
```bash
:!ls -la | grep txt         # 列出目录中的txt文件
:!ps aux | grep vim         # 查找vim进程
:!cat file | sort | uniq    # 文件内容排序去重
```

### 8.3 实用命令组合示例


**🔧 文件处理组合**：
```bash
# 统计代码行数
:!find . -name "*.py" | xargs wc -l | sort -n

# 查找文件中的特定内容
:!grep -r "function" *.js | head -10

# 磁盘使用情况排序
:!du -h * | sort -hr | head -5
```

**📊 系统监控组合**：
```bash
# 查看占用内存最多的进程
:!ps aux | sort -k4 -nr | head -10

# 查看网络连接状态
:!netstat -an | grep LISTEN | sort

# 查看文件修改时间
:!ls -lt | head -5
```

### 8.4 在vim中的高级应用


**⚡ 动态内容更新**：
```bash
# 插入系统状态报告
:r !echo "=== 系统状态报告 ==="
:r !date
:r !uptime | cut -d',' -f1
:r !free -h | head -2
:r !df -h | head -2
```

**🎯 文件内容处理**：
```bash
# 对当前文件内容进行处理
:%!sort                     # 对整个文件排序
:1,10!sort                  # 对前10行排序  
:%!uniq                     # 去除重复行
```

### 8.5 错误处理和调试


**🔍 命令调试技巧**：
```bash
# 查看命令是否存在
:!which grep

# 测试管道每一步
:!ls -la                    # 第一步
:!ls -la | grep txt         # 第二步
:!ls -la | grep txt | wc -l # 完整管道
```

**⚠️ 常见问题解决**：
```bash
# 命令未找到：检查PATH环境变量
:!echo $PATH

# 权限不足：使用sudo
:!sudo ls -la /root

# 输出太多：使用head或tail限制
:!dmesg | tail -20
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的基础操作


```
🔸 命令模式进入：按:键，屏幕底部出现冒号提示
🔸 历史记录：上下箭头浏览之前输入的命令  
🔸 Tab补全：自动补全命令、文件名和路径
🔸 外部命令：:!command 在vim中执行系统命令
🔸 读取文件：:r filename 插入其他文件内容
🔸 保存文件：:w filename 保存到指定文件
🔸 命令组合：使用管道 | 连接多个命令
```

### 9.2 关键理解要点


**🔹 Ex命令模式的本质**：
```
作用：vim的控制中心，执行各种文件操作和系统命令
特点：功能强大、操作灵活、与系统深度集成
优势：不用退出编辑器就能完成复杂操作
```

**🔹 效率提升技巧**：
```
历史记录 + Tab补全：减少重复输入
外部命令执行：编辑和系统操作无缝结合  
文件读写操作：快速整合多文件内容
管道组合使用：实现复杂的数据处理
```

### 9.3 实际应用场景


**💼 日常开发工作**：
- **代码编辑**：边写代码边编译测试
- **配置管理**：读取配置模板，批量生成配置文件
- **日志分析**：实时查看日志，提取关键信息
- **文档写作**：插入系统信息，生成动态内容

**🎓 学习和练习**：
- **系统管理**：在编辑配置文件时查看系统状态
- **脚本调试**：边写脚本边测试执行结果  
- **数据处理**：用管道处理文本数据
- **环境配置**：快速查看和修改系统配置

### 9.4 记忆技巧和口诀


**🧠 核心记忆口诀**：
```
冒号进入命令行，上下翻找历史全
Tab补全省时间，感叹号外命令连
r读文件插当前，w写文件保存全  
管道组合功能强，一气呵成效率高
```

**🎯 关键字联想**：
- `:` = command = 命令控制
- `!` = execute = 执行外部
- `r` = read = 读取插入  
- `w` = write = 写入保存
- `|` = pipe = 管道连接

**📚 渐进学习路径**：
1. **基础操作**：熟练进入命令模式，掌握基本保存退出
2. **效率提升**：使用历史记录和Tab补全
3. **功能扩展**：掌握外部命令和文件读写
4. **高级应用**：灵活运用命令组合和管道操作

**核心记忆**：Ex命令模式是vim的强大控制中心，让文本编辑与系统操作完美结合，掌握这些操作能显著提升Linux环境下的工作效率。