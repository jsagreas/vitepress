---
title: 14、替换命令深入应用
---
## 📚 目录

1. [替换命令基础概念](#1-替换命令基础概念)
2. [基本替换语法详解](#2-基本替换语法详解)
3. [全文替换操作](#3-全文替换操作)
4. [指定范围替换](#4-指定范围替换)
5. [替换标志详解](#5-替换标志详解)
6. [重复替换操作](#6-重复替换操作)
7. [特殊字符处理](#7-特殊字符处理)
8. [替换确认模式](#8-替换确认模式)
9. [实际应用场景](#9-实际应用场景)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 📝 替换命令基础概念


### 1.1 什么是替换命令


**替换命令**就像是文本编辑器中的"查找和替换"功能，但功能更强大。想象你写了一篇文章，突然发现某个词写错了，需要把所有错误的词都改正，替换命令就是专门干这个活的。

> 💡 **核心理解**
> 
> 替换命令的本质：找到指定内容 → 用新内容替换掉
> 就像把文档中所有的"错别字"一键改成"正确字"

### 1.2 替换命令的工作原理


```
原理图示：
文件内容: Hello world, hello Linux, Hello vim
         ↓ 执行替换命令 s/Hello/Hi/g
结果内容: Hi world, hello Linux, Hi vim
```

**工作流程**：
1. **扫描文本**：按指定范围查找目标内容
2. **模式匹配**：找到所有符合条件的文本
3. **执行替换**：用新文本替换旧文本
4. **显示结果**：告诉你替换了多少处

### 1.3 替换命令的优势


| 对比项 | **手动修改** | **替换命令** |
|--------|-------------|-------------|
| 🕐 **速度** | `慢，一个一个改` | `瞬间完成大量替换` |
| 🎯 **准确性** | `容易遗漏或出错` | `精确匹配，不遗漏` |
| 📊 **批量处理** | `无法批量处理` | `一次处理整个文件` |
| 🔄 **可撤销** | `难以撤销` | `支持撤销操作` |

---

## 2. 🔧 基本替换语法详解


### 2.1 :s/// 基本语法结构


**基本格式**：`:s/原内容/新内容/标志`

```
语法拆解：
:     ← 命令模式前缀
s     ← substitute（替换）命令
/     ← 分隔符（也可用其他字符）
原内容 ← 要被替换的文本
/     ← 分隔符
新内容 ← 替换后的文本
/     ← 分隔符
标志   ← 控制替换行为的选项
```

### 2.2 简单替换示例


**示例文本**：
```
Today is Monday.
Tomorrow will be Tuesday.
Monday is the first day of week.
```

**基本替换操作**：
```bash
# 1. 替换当前行第一个"Monday"
:s/Monday/Sunday/

结果：Today is Sunday.        ← 只改了第一个Monday
     Tomorrow will be Tuesday.
     Monday is the first day of week. ← 这行的Monday没变
```

> ⚠️ **重要提醒**
> 
> 基本的 `:s///` 只替换**当前行的第一个**匹配项
> 如果想替换更多，需要添加特殊标志

### 2.3 分隔符的选择技巧


**默认分隔符**：`/`
```bash
:s/old/new/
```

**当内容包含 `/` 时，可换用其他分隔符**：
```bash
# 替换文件路径时，用#作分隔符更清晰
:s#/usr/local/bin#/opt/bin#

# 也可以用@、|等字符
:s@old@new@
:s|old|new|
```

---

## 3. 🌐 全文替换操作


### 3.1 :%s/// 全文替换语法


**语法**：`:%s/原内容/新内容/标志`

其中 `%` 表示整个文件的所有行。

```
范围标识含义：
%     ← 整个文件（从第1行到最后一行）
等同于 1,$ 
```

### 3.2 全文替换示例


**示例场景**：把配置文件中所有的 `localhost` 改成 `192.168.1.100`

```bash
# 原文件内容
server=localhost:8080
database_host=localhost
cache_server=localhost:6379
```

```bash
# 执行全文替换
:%s/localhost/192.168.1.100/g

# 结果
server=192.168.1.100:8080
database_host=192.168.1.100
cache_server=192.168.1.100:6379
```

> 💡 **注意标志 `g`**
> 
> - 不加 `g`：每行只替换第一个匹配项
> - 加上 `g`：每行替换所有匹配项

### 3.3 全文替换的应用场景


| 场景 | **命令示例** | **说明** |
|------|-------------|----------|
| 🔧 **配置修改** | `:%s/debug=true/debug=false/g` | `批量修改配置参数` |
| 📝 **格式统一** | `:%s/　/ /g` | `全角空格改半角空格` |
| 🏷️ **标签替换** | `:%s/<old-tag>/<new-tag>/g` | `HTML/XML标签批量修改` |
| 💻 **代码重构** | `:%s/oldFunction/newFunction/g` | `函数名批量修改` |

---

## 4. 🎯 指定范围替换


### 4.1 行范围替换语法


**基本格式**：`:起始行,结束行s/原内容/新内容/标志`

```
范围表示方法：
数字,数字    ← 具体行号范围
.           ← 当前行
$           ← 最后一行
%           ← 整个文件（1,$的简写）
```

### 4.2 常用范围表示


**具体范围示例**：
```bash
# 替换第5行到第10行
:5,10s/old/new/g

# 替换第1行到第20行
:1,20s/old/new/g

# 替换从当前行到文件末尾
:.,$s/old/new/g

# 替换从第1行到当前行
:1,.s/old/new/g
```

### 4.3 相对范围表示


**相对行号**：
```bash
# 当前行往下3行（包含当前行，共4行）
:.,+3s/old/new/g

# 当前行往上2行到当前行
:-2,.s/old/new/g

# 当前行前后各2行（共5行）
:-2,+2s/old/new/g
```

### 4.4 可视模式范围替换


**操作步骤**：
1. **选择范围**：用 `V`（行选择）或 `Ctrl+v`（块选择）选中要替换的区域
2. **执行替换**：输入 `:s/old/new/g`

```
可视模式替换流程：
1. 按V进入行选择模式
2. 移动光标选择多行
3. 输入:（会自动显示 :'<,'>）
4. 继续输入 s/old/new/g
5. 按回车执行
```

---

## 5. 🏷️ 替换标志详解


### 5.1 /g 全局标志


**含义**：Global，在每行中替换所有匹配项

```bash
# 示例文本：apple apple orange apple
:s/apple/banana/     # 结果：banana apple orange apple（只替换第一个）
:s/apple/banana/g    # 结果：banana banana orange banana（替换所有）
```

### 5.2 /c 确认标志


**含义**：Confirm，每次替换前都询问用户确认

```bash
:s/old/new/gc   # 每个匹配项都会询问是否替换
```

**确认选项**：
```
替换确认提示及选项：
y    ← Yes，替换这一个
n    ← No，跳过这一个  
a    ← All，替换后续所有（不再询问）
q    ← Quit，退出替换
l    ← Last，替换这一个后退出
^E   ← 向下滚动查看更多上下文
^Y   ← 向上滚动查看更多上下文
```

### 5.3 /i 和 /I 大小写标志


**大小写处理**：
```bash
# /i：忽略大小写（ignore case）
:s/HELLO/hi/gi    # HELLO、Hello、hello都会被替换

# /I：强制区分大小写（Force case sensitive）
:s/Hello/hi/I     # 只有完全匹配Hello的才替换（即使设置了ignorecase）
```

### 5.4 标志组合使用


**多标志组合**：
```bash
# 常用组合
:s/old/new/gi     # 全局替换，忽略大小写
:s/old/new/gc     # 全局替换，逐一确认
:s/old/new/gci    # 全局替换，逐一确认，忽略大小写
```

---

## 6. 🔄 重复替换操作


### 6.1 & 重复上次替换


**作用**：重复执行上一次的替换命令

```bash
# 操作示例
:s/apple/orange/g    # 第一次替换命令
# 移动到其他行
&                    # 重复上次替换（在当前行执行）
```

**使用场景**：
```
实用场景演示：
1. 在第一行执行：:s/old/new/g
2. 移动到第5行，按 &              ← 在第5行执行相同替换
3. 移动到第10行，按 &             ← 在第10行执行相同替换
4. 移动到第15行，按 &             ← 在第15行执行相同替换
```

### 6.2 g& 全文重复替换


**作用**：在整个文件中重复上次替换

```bash
# 先执行一个替换命令
:s/debug/info/

# 然后用g&在全文件重复这个替换
g&
# 等同于 :%s/debug/info/
```

### 6.3 重复替换的技巧


> 💡 **效率技巧**
> 
> 1. **先测试**：在一行上测试替换效果
> 2. **再批量**：用 `&` 或 `g&` 批量应用
> 3. **组合使用**：先局部替换看效果，再全局应用

---

## 7. 🔐 特殊字符处理


### 7.1 需要转义的特殊字符


**基本转义字符**：
```bash
# 这些字符有特殊含义，需要用\转义
. * ^ $ [ ] \ /

# 替换包含这些字符的内容时要转义
:s/\./,/g           # 把.替换成,
:s/\*/plus/g        # 把*替换成plus
:s/\^/caret/g       # 把^替换成caret
```

### 7.2 常见转义场景


**文件路径替换**：
```bash
# 错误方式（/会被理解为分隔符）
:s//usr/local//home/user/   # 这样写是错误的

# 正确方式1：转义斜杠
:s/\/usr\/local/\/home\/user/

# 正确方式2：换用其他分隔符
:s#/usr/local#/home/user#
```

**正则表达式字符**：
```bash
# 替换包含正则字符的内容
:s/\[error\]/[warning]/g    # 替换[error]为[warning]
:s/\$price/\$cost/g         # 替换$price为$cost
```

### 7.3 特殊替换模式


**换行符处理**：
```bash
# 把两行合并成一行
:s/\n/ /            # 把换行符替换成空格

# 在行末添加内容
:s/$/;/g            # 在每行末尾添加分号
```

**制表符和空格**：
```bash
# 把制表符替换成4个空格
:s/\t/    /g

# 去除行末空格
:s/ \+$//g
```

---

## 8. ✅ 替换确认模式


### 8.1 确认模式的使用场景


**什么时候用确认模式**：
- 🔍 **不确定范围**：不确定会替换哪些内容
- ⚠️ **重要修改**：修改重要配置文件
- 🎯 **选择性替换**：只想替换部分匹配项
- 📋 **学习阶段**：初学时用来理解替换过程

### 8.2 确认模式操作详解


**完整操作流程**：
```
1. 输入命令：:%s/old/new/gc
2. 系统显示：replace with new (y/n/a/q/l/^E/^Y)?
3. 查看匹配：当前匹配项会高亮显示
4. 做出选择：输入对应字母
5. 继续或退出：根据选择继续下一个或退出
```

### 8.3 确认选项详细说明


| 选项 | **含义** | **操作结果** | **使用场景** |
|------|---------|-------------|-------------|
| `y` | **Yes，替换** | `替换当前项，继续下一个` | `确定要替换这个` |
| `n` | **No，跳过** | `跳过当前项，继续下一个` | `这个不替换` |
| `a` | **All，全部** | `替换所有剩余项` | `剩下的都替换` |
| `q` | **Quit，退出** | `退出替换操作` | `不想继续了` |
| `l` | **Last，最后** | `替换这个后退出` | `只替换这最后一个` |

### 8.4 确认模式实战示例


**示例场景**：修改日志级别配置
```bash
# 文件内容
log.level=debug
error.level=debug  
app.debug=true
debug.mode=on
```

```bash
# 使用确认模式
:%s/debug/info/gc

# 逐一询问过程：
# 匹配1：log.level=debug -> 选择y（替换）
# 匹配2：error.level=debug -> 选择n（跳过，错误日志保持debug）
# 匹配3：app.debug=true -> 选择n（这是布尔值，不替换）
# 匹配4：debug.mode=on -> 选择y（替换）
```

---

## 9. 🛠️ 实际应用场景


### 9.1 配置文件批量修改


**场景**：服务器IP地址变更
```bash
# 原配置文件多处引用旧IP
database_host=192.168.1.50
cache_server=192.168.1.50:6379
api_endpoint=http://192.168.1.50:8080

# 一键更新所有IP
:%s/192\.168\.1\.50/10.0.0.100/g
```

> 💡 **注意点号转义**
> 
> IP地址中的`.`需要转义为`\.`，否则会被当作正则表达式的"任意字符"

### 9.2 代码重构应用


**场景1：函数重命名**
```bash
# 把所有的getUserInfo改为fetchUserData
:%s/getUserInfo/fetchUserData/g
```

**场景2：变量名统一**
```bash
# 把驼峰命名改为下划线命名
:%s/userName/user_name/g
:%s/userId/user_id/g
```

### 9.3 文档格式化


**场景：Markdown文档整理**
```bash
# 统一标题格式（把##改为###）
:%s/^## /### /g

# 去除多余空行
:%s/\n\n\n/\n\n/g

# 统一代码块标记
:%s/```bash/```shell/g
```

### 9.4 日志文件处理


**场景：敏感信息脱敏**
```bash
# 用户ID脱敏（保留前3位，后面用*代替）
:%s/user_id=\(\d\d\d\)\d*/user_id=\1***/g

# 邮箱脱敏
:%s/\([a-zA-Z0-9]\{2\}\)[a-zA-Z0-9]*\(@[a-zA-Z0-9.-]*\)/\1***\2/g
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的基本语法


```
🔸 基本替换：:s/old/new/        （当前行第一个）
🔸 全局替换：:s/old/new/g       （当前行所有）
🔸 全文替换：:%s/old/new/g      （整个文件）
🔸 范围替换：:1,10s/old/new/g   （指定行范围）
🔸 确认替换：:s/old/new/gc      （逐一确认）
```

### 10.2 重要标志含义


| 标志 | **含义** | **记忆方法** |
|------|---------|-------------|
| `g` | **全局替换** | `Global - 全部替换` |
| `c` | **确认模式** | `Confirm - 确认询问` |
| `i` | **忽略大小写** | `Ignore case - 忽略` |
| `I` | **区分大小写** | `Force case - 强制` |

### 10.3 关键操作技巧


**🔹 范围选择技巧**
```
.          当前行
$          最后一行  
%          整个文件
1,10       第1到10行
.,+5       当前行往下5行
```

**🔹 特殊字符处理**
```
需要转义：. * ^ $ [ ] \ /
转义方法：在字符前加 \
替代方案：换用其他分隔符（# @ |）
```

**🔹 效率提升方法**
```
&          重复上次替换（当前行）
g&         重复上次替换（全文件）
:s///      空模式重复上次查找内容
```

### 10.4 实用记忆口诀


```
替换命令要记牢，冒号s来开头，
斜杠分隔三段式，原文新文标志后。
全局标志g最常用，确认标志c要选择，
百分号表示全文件，数字范围更精确。
特殊字符要转义，反斜杠来帮助你，
重复操作用&号，效率提升有技巧。
```

### 10.5 学习建议


**🎯 循序渐进**
1. **先掌握基本语法**：`:s/old/new/`
2. **再学全局标志**：加上 `/g`
3. **然后学范围控制**：`:%s///` 和 `:1,10s///`
4. **最后学高级技巧**：确认模式、特殊字符等

**💡 实践建议**
- 重要文件**先备份**再操作
- 复杂替换**先测试**小范围
- 善用**确认模式**避免误操作
- 多练习**常用场景**提高熟练度

**核心记忆**：
- 替换命令格式固定，掌握基本语法是关键
- 标志控制行为，g、c、i最常用
- 特殊字符要转义，选对分隔符很重要
- 范围控制很灵活，从单行到全文件都可以