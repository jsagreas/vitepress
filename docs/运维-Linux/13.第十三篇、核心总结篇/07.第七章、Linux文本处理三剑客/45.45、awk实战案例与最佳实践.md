---
title: 45ã€awkå®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•


1. [ä¼ä¸šçº§åº”ç”¨æ¡ˆä¾‹](#1-ä¼ä¸šçº§åº”ç”¨æ¡ˆä¾‹)
2. [æ€§èƒ½è°ƒä¼˜å®è·µ](#2-æ€§èƒ½è°ƒä¼˜å®è·µ)
3. [é”™è¯¯å¤„ç†æœºåˆ¶](#3-é”™è¯¯å¤„ç†æœºåˆ¶)
4. [ä»£ç è§„èŒƒæ ‡å‡†](#4-ä»£ç è§„èŒƒæ ‡å‡†)
5. [æµ‹è¯•éªŒè¯æ–¹æ³•](#5-æµ‹è¯•éªŒè¯æ–¹æ³•)
6. [éƒ¨ç½²ç­–ç•¥](#6-éƒ¨ç½²ç­–ç•¥)
7. [ç»´æŠ¤æœ€ä½³å®è·µ](#7-ç»´æŠ¤æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¢ ä¼ä¸šçº§åº”ç”¨æ¡ˆä¾‹



### 1.1 æ—¥å¿—åˆ†æä¸ç›‘æ§ç³»ç»Ÿ



**ğŸ¯ åº”ç”¨åœºæ™¯**ï¼šåˆ†æWebæœåŠ¡å™¨è®¿é—®æ—¥å¿—ï¼Œå®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€

â”Œâ”€ å®é™…éœ€æ±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ ç»Ÿè®¡æ¯å°æ—¶è®¿é—®é‡         â”‚
â”‚ â€¢ è¯†åˆ«å¼‚å¸¸IPè®¿é—®           â”‚
â”‚ â€¢ åˆ†æå“åº”æ—¶é—´åˆ†å¸ƒ         â”‚
â”‚ â€¢ ç”Ÿæˆç›‘æ§æŠ¥è¡¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

**æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å®æ—¶è®¿é—®é‡ç›‘æ§è„šæœ¬

#!/bin/bash

tail -f /var/log/nginx/access.log | awk '
BEGIN {
#    # åˆå§‹åŒ–è®¡æ•°å™¨å’Œæ—¶é—´çª—å£
    hour_count = 0
    current_hour = ""
    threshold = 1000  # æ¯å°æ—¶è®¿é—®é˜ˆå€¼
}

{
#    # æå–æ—¶é—´æˆ³ [18/Mar/2024:14:30:22 +0800]
    gsub(/\[|\]/, "", $4)
    split($4, datetime, ":")
    hour = datetime[1] ":" datetime[2]
    
#    # æ–°çš„å°æ—¶å¼€å§‹
    if (current_hour != hour) {
        if (current_hour != "") {
            print current_hour ": " hour_count " è®¿é—®"
            if (hour_count > threshold) {
                print "âš ï¸  è­¦å‘Šï¼šè®¿é—®é‡å¼‚å¸¸ " hour_count " > " threshold
            }
        }
        current_hour = hour
        hour_count = 1
    } else {
        hour_count++
    }
    
#    # å“åº”æ—¶é—´åˆ†æï¼ˆå‡è®¾åœ¨ç¬¬10ä¸ªå­—æ®µï¼‰
    response_time = $10
    if (response_time > 5) {
        print "ğŸŒ æ…¢è¯·æ±‚ï¼š" $7 " å“åº”æ—¶é—´ï¼š" response_time "s"
    }
}'
```

**ğŸ” IPè®¿é—®é¢‘ç‡åˆ†æ**ï¼š
```bash
# åˆ†æå¯ç–‘IPè®¿é—®æ¨¡å¼

awk '{
    ip = $1
    ip_count[ip]++
    
#    # ç»Ÿè®¡æ¯ä¸ªIPçš„è®¿é—®æ—¶é—´
    gsub(/\[|\]/, "", $4)
    access_time[ip] = access_time[ip] " " $4
}
END {
    print "ğŸ” IPè®¿é—®ç»Ÿè®¡æŠ¥å‘Š"
    print "=" x 50
    
    for (ip in ip_count) {
        if (ip_count[ip] > 100) {
            print "âš ï¸  é«˜é¢‘IPï¼š" ip " è®¿é—®æ¬¡æ•°ï¼š" ip_count[ip]
            
#            # åˆ†æè®¿é—®æ—¶é—´åˆ†å¸ƒ
            split(access_time[ip], times, " ")
            if (length(times) > 50) {  # çŸ­æ—¶é—´å†…å¤§é‡è®¿é—®
                print "   å¯ç–‘åŸå› ï¼šçŸ­æ—¶é—´å¤§é‡è¯·æ±‚"
            }
        }
    }
}' /var/log/nginx/access.log
```

### 1.2 æ•°æ®åº“æ€§èƒ½åˆ†æç³»ç»Ÿ



**ğŸ’¾ åº”ç”¨åœºæ™¯**ï¼šåˆ†æMySQLæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä¼˜åŒ–æ•°æ®åº“æ€§èƒ½

```bash
# MySQLæ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ

awk '
/^# Time:/ {
    query_time = $3 " " $4
}

/^# Query_time:/ {
    duration = $3
    lock_time = $5
    rows_sent = $7
    rows_examined = $9
}

/^# User@Host:/ {
    user_info = $0
}

/^[^#]/ && !/^$/ {
#    # è¿™æ˜¯SQLè¯­å¥
    sql = ""
    while (getline > 0 && !/^#/ && !/^$/) {
        sql = sql $0 " "
    }
    
#    # åˆ†æå’Œåˆ†ç±»æŸ¥è¯¢
    if (duration > 10) {
        print "ğŸ”¥ è¶…æ…¢æŸ¥è¯¢ (" duration "s)ï¼š"
        print "   æ—¶é—´ï¼š" query_time
        print "   SQLï¼š" substr(sql, 1, 100) "..."
        print ""
        
        slow_queries[sql]++
        total_slow_time += duration
    }
    
#    # ç»Ÿè®¡è¡¨è®¿é—®é¢‘ç‡
    if (match(sql, /FROM[ \t]+([a-zA-Z_][a-zA-Z0-9_]*)/)) {
        table = substr(sql, RSTART+5, RLENGTH-5)
        gsub(/[ \t].*/, "", table)
        table_access[table]++
    }
}

END {
    print "ğŸ“Š æ…¢æŸ¥è¯¢ç»Ÿè®¡æŠ¥å‘Š"
    print "æ€»æ…¢æŸ¥è¯¢æ—¶é—´ï¼š" total_slow_time "ç§’"
    print ""
    
    print "ğŸ† æœ€é¢‘ç¹æ…¢æŸ¥è¯¢TOP5ï¼š"
#    # è¿™é‡Œç®€åŒ–äº†æ’åºé€»è¾‘
    for (query in slow_queries) {
        print slow_queries[query] "æ¬¡ï¼š" substr(query, 1, 80) "..."
    }
}' /var/log/mysql/slow.log
```

### 1.3 ç³»ç»Ÿèµ„æºç›‘æ§è„šæœ¬



**âš¡ åº”ç”¨åœºæ™¯**ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

```bash
# ç³»ç»Ÿèµ„æºç›‘æ§dashboard

#!/bin/bash

while true; do
    clear
    echo "ğŸ–¥ï¸  ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿ - $(date)"
    echo "=" x 60
    
#    # CPUä½¿ç”¨ç‡åˆ†æ
    top -bn1 | awk '
    /^%Cpu/ {
        gsub(/[,%]/, "", $0)
        user = $2
        system = $4
        idle = $8
        
        printf "ğŸ’» CPUä½¿ç”¨ç‡ï¼šç”¨æˆ· %.1f%% | ç³»ç»Ÿ %.1f%% | ç©ºé—² %.1f%%\n", 
               user, system, idle
        
        if (user + system > 80) {
            print "   âš ï¸  CPUä½¿ç”¨ç‡è¿‡é«˜ï¼"
        }
    }'
    
#    # å†…å­˜ä½¿ç”¨åˆ†æ
    free | awk '
    /^Mem:/ {
        total = $2
        used = $3
        free = $4
        available = $7
        
        usage_percent = (used / total) * 100
        
        printf "ğŸ§  å†…å­˜ä½¿ç”¨ï¼š%.1fGB / %.1fGB (%.1f%%)\n", 
               used/1024/1024, total/1024/1024, usage_percent
        
        if (usage_percent > 85) {
            print "   âš ï¸  å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼"
        }
    }'
    
#    # ç£ç›˜ç©ºé—´åˆ†æ
    df -h | awk '
    NR > 1 && $5 != "0%" {
        gsub(/%/, "", $5)
        usage = $5
        
        printf "ğŸ’½ ç£ç›˜ %sï¼š%s / %s (%s%%)\n", $6, $3, $2, $5
        
        if (usage > 90) {
            print "   ğŸ”´ ç£ç›˜ç©ºé—´ä¸¥é‡ä¸è¶³ï¼"
        } else if (usage > 80) {
            print "   ğŸŸ¡ ç£ç›˜ç©ºé—´ç´§å¼ "
        }
    }'
    
    sleep 5
done
```

---

## 2. âš¡ æ€§èƒ½è°ƒä¼˜å®è·µ



### 2.1 awkç¨‹åºæ€§èƒ½ä¼˜åŒ–åŸåˆ™



**ğŸ¯ æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥**

â”Œâ”€ æ€§èƒ½ä¼˜åŒ–é‡‘å­—å¡” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å‡å°‘ä¸å¿…è¦çš„æ“ä½œ       â”‚
â”‚  â†™              â†˜       â”‚
â”‚ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼    åˆç†ä½¿ç”¨æ•°ç»„â”‚
â”‚  â†™              â†˜       â”‚
â”‚é¿å…é‡å¤è®¡ç®—    é€‰æ‹©é«˜æ•ˆç®—æ³• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

**ğŸ”§ å®ç”¨ä¼˜åŒ–æŠ€å·§**ï¼š

```bash
# âŒ ä½æ•ˆå†™æ³•ï¼šé‡å¤ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼

awk '{
    if ($0 ~ /ERROR/) print "é”™è¯¯ï¼š" $0
    if ($0 ~ /ERROR/) error_count++
    if ($0 ~ /ERROR/) error_lines[NR] = $0
}' logfile.txt

# âœ… é«˜æ•ˆå†™æ³•ï¼šä¸€æ¬¡åŒ¹é…å¤šæ¬¡ä½¿ç”¨

awk '{
    if ($0 ~ /ERROR/) {
        print "é”™è¯¯ï¼š" $0
        error_count++
        error_lines[NR] = $0
    }
}' logfile.txt
```

**ğŸƒ å­—ç¬¦ä¸²æ“ä½œä¼˜åŒ–**ï¼š

```bash
# âŒ ä½æ•ˆï¼šé¢‘ç¹ä½¿ç”¨gsub

awk '{
    gsub(/pattern1/, "replacement1", $0)
    gsub(/pattern2/, "replacement2", $0)  
    gsub(/pattern3/, "replacement3", $0)
    print
}'

# âœ… é«˜æ•ˆï¼šåˆå¹¶æ“ä½œæˆ–ä½¿ç”¨æ¡ä»¶åˆ¤æ–­

awk '{
    line = $0
    if (line ~ /pattern1/) gsub(/pattern1/, "replacement1", line)
    if (line ~ /pattern2/) gsub(/pattern2/, "replacement2", line)
    if (line ~ /pattern3/) gsub(/pattern3/, "replacement3", line)
    print line
}'
```

### 2.2 å¤§æ•°æ®å¤„ç†ä¼˜åŒ–



**ğŸ“Š å¤„ç†å¤§æ–‡ä»¶çš„æœ€ä½³å®è·µ**

ğŸŸ¦ **åŸºç¡€ä¼˜åŒ–**ï¼šé¿å…ä¸å¿…è¦çš„å¤„ç†
```bash
# åªå¤„ç†åŒ…å«ç‰¹å®šæ¨¡å¼çš„è¡Œ

awk '/ERROR|WARNING/ {
#    # å¤æ‚å¤„ç†é€»è¾‘åªåœ¨åŒ¹é…è¡Œæ‰§è¡Œ
    process_line($0)
}
function process_line(line) {
#    # å…·ä½“å¤„ç†é€»è¾‘
}'
```

ğŸŸ¨ **è¿›é˜¶ä¼˜åŒ–**ï¼šæ•°ç»„ä½¿ç”¨ç­–ç•¥
```bash
# âŒ ä½æ•ˆï¼šæ— é™åˆ¶çš„æ•°ç»„å¢é•¿

awk '{
    all_lines[NR] = $0  # å†…å­˜ä¼šæ— é™å¢é•¿
}'

# âœ… é«˜æ•ˆï¼šæ§åˆ¶æ•°ç»„å¤§å°

awk '{
    if (NR % 1000 == 0) {  # æ¯1000è¡Œå¤„ç†ä¸€æ¬¡
        for (i in temp_array) {
            process_data(temp_array[i])
            delete temp_array[i]
        }
    }
    temp_array[NR % 1000] = $0
}'
```

**âš™ï¸ å†…å­˜ç®¡ç†æŠ€å·§**

```bash
# åˆ†å—å¤„ç†å¤§æ–‡ä»¶

function process_large_file(filename) {
    chunk_size = 10000
    current_chunk = 0
    
    while ((getline line < filename) > 0) {
        chunk_data[current_chunk++] = line
        
        if (current_chunk >= chunk_size) {
#            # å¤„ç†å½“å‰å—
            process_chunk(chunk_data, current_chunk)
            
#            # æ¸…ç†å†…å­˜
            for (i in chunk_data) delete chunk_data[i]
            current_chunk = 0
        }
    }
    
#    # å¤„ç†å‰©ä½™æ•°æ®
    if (current_chunk > 0) {
        process_chunk(chunk_data, current_chunk)
    }
}
```

---

## 3. âš ï¸ é”™è¯¯å¤„ç†æœºåˆ¶



### 3.1 å¸¸è§é”™è¯¯ç±»å‹ä¸å¤„ç†



**ğŸ” æ–‡ä»¶æ“ä½œé”™è¯¯å¤„ç†**

```bash
# å®‰å…¨çš„æ–‡ä»¶è¯»å–

awk '
BEGIN {
    filename = "data.txt"
    
#    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if ((getline test_line < filename) < 0) {
        print "âŒ é”™è¯¯ï¼šæ— æ³•è¯»å–æ–‡ä»¶ " filename > "/dev/stderr"
        exit 1
    }
    close(filename)
    
    print "âœ… å¼€å§‹å¤„ç†æ–‡ä»¶ï¼š" filename
}

{
#    # å®‰å…¨çš„å­—æ®µè®¿é—®
    if (NF < 3) {
        print "âš ï¸  è­¦å‘Šï¼šç¬¬" NR "è¡Œå­—æ®µä¸è¶³ï¼Œè·³è¿‡" > "/dev/stderr"
        next
    }
    
#    # æ•°å€¼è½¬æ¢é”™è¯¯å¤„ç†
    if ($3 !~ /^[0-9]+(\.[0-9]+)?$/) {
        print "âš ï¸  è­¦å‘Šï¼šç¬¬" NR "è¡Œç¬¬3å­—æ®µä¸æ˜¯æ•°å­—ï¼š" $3 > "/dev/stderr"
        error_count++
        next
    }
    
#    # æ­£å¸¸å¤„ç†
    total += $3
    count++
}

END {
    if (count == 0) {
        print "âŒ é”™è¯¯ï¼šæ²¡æœ‰æœ‰æ•ˆæ•°æ®" > "/dev/stderr"
        exit 1
    }
    
    print "âœ… å¤„ç†å®Œæˆï¼š"
    print "   æœ‰æ•ˆè®°å½•ï¼š" count
    print "   é”™è¯¯è®°å½•ï¼š" error_count
    print "   å¹³å‡å€¼ï¼š" (total / count)
}'
```

### 3.2 æ•°æ®éªŒè¯ä¸æ¸…æ´—



**ğŸ§¹ æ•°æ®è´¨é‡æ£€æŸ¥æ¡†æ¶**

```bash
#!/bin/bash

# æ•°æ®è´¨é‡æ£€æŸ¥è„šæœ¬

awk '
BEGIN {
#    # åˆå§‹åŒ–é”™è¯¯ç»Ÿè®¡
    errors["missing_fields"] = 0
    errors["invalid_format"] = 0  
    errors["out_of_range"] = 0
    errors["duplicate_keys"] = 0
    
    print "ğŸ” å¼€å§‹æ•°æ®è´¨é‡æ£€æŸ¥..."
}

{
    line_errors = 0
    
#    # æ£€æŸ¥å­—æ®µå®Œæ•´æ€§
    if (NF < 5) {
        errors["missing_fields"]++
        print "ğŸ“‹ ç¬¬" NR "è¡Œï¼šå­—æ®µä¸è¶³(" NF "/5)" > "errors.log"
        line_errors++
    }
    
#    # æ£€æŸ¥æ•°æ®æ ¼å¼
    if ($1 !~ /^[A-Z]{3}[0-9]{3}$/) {
        errors["invalid_format"]++
        print "ğŸ“ ç¬¬" NR "è¡Œï¼šIDæ ¼å¼é”™è¯¯ " $1 > "errors.log"
        line_errors++
    }
    
#    # æ£€æŸ¥æ•°å€¼èŒƒå›´
    if ($3 < 0 || $3 > 100) {
        errors["out_of_range"]++
        print "ğŸ“Š ç¬¬" NR "è¡Œï¼šæ•°å€¼è¶…å‡ºèŒƒå›´ " $3 > "errors.log"
        line_errors++
    }
    
#    # æ£€æŸ¥é‡å¤é”®
    if ($1 in seen_keys) {
        errors["duplicate_keys"]++
        print "ğŸ”„ ç¬¬" NR "è¡Œï¼šé‡å¤çš„é”® " $1 > "errors.log"
        line_errors++
    } else {
        seen_keys[$1] = 1
    }
    
#    # ç»Ÿè®¡
    if (line_errors == 0) {
        valid_records++
        print $0 > "clean_data.txt"
    } else {
        invalid_records++
    }
    
    total_records++
}

END {
    print "\nğŸ“ˆ æ•°æ®è´¨é‡æŠ¥å‘Š"
    print "=" x 40
    print "æ€»è®°å½•æ•°ï¼š" total_records
    print "æœ‰æ•ˆè®°å½•ï¼š" valid_records " (" (valid_records/total_records*100) "%)"
    print "æ— æ•ˆè®°å½•ï¼š" invalid_records " (" (invalid_records/total_records*100) "%)"
    print ""
    print "é”™è¯¯ç±»å‹ç»Ÿè®¡ï¼š"
    print "  ç¼ºå¤±å­—æ®µï¼š" errors["missing_fields"]
    print "  æ ¼å¼é”™è¯¯ï¼š" errors["invalid_format"] 
    print "  èŒƒå›´é”™è¯¯ï¼š" errors["out_of_range"]
    print "  é‡å¤é”®å€¼ï¼š" errors["duplicate_keys"]
    
    if (invalid_records > total_records * 0.1) {
        print "âŒ è­¦å‘Šï¼šæ•°æ®è´¨é‡è¾ƒå·®ï¼Œé”™è¯¯ç‡è¶…è¿‡10%"
        exit 1
    } else {
        print "âœ… æ•°æ®è´¨é‡æ£€æŸ¥é€šè¿‡"
    }
}'
```

---

## 4. ğŸ“ ä»£ç è§„èŒƒæ ‡å‡†



### 4.1 awkä»£ç é£æ ¼æŒ‡å—



**ğŸ¨ å‘½åè§„èŒƒ**

```bash
# âœ… è‰¯å¥½çš„å˜é‡å‘½å

awk '
BEGIN {
#    # å¸¸é‡ä½¿ç”¨å¤§å†™
    MAX_RETRY_COUNT = 3
    DEFAULT_TIMEOUT = 30
    
#    # å˜é‡ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”
    user_count = 0
    error_message = ""
    total_response_time = 0
    
#    # æ•°ç»„åç§°è¦æ¸…æ™°
    user_sessions["id"] = ""
    error_codes[500] = "å†…éƒ¨æœåŠ¡å™¨é”™è¯¯"
}

# å‡½æ•°åä½¿ç”¨åŠ¨è¯å¼€å¤´

function calculate_average(numbers, count) {
    if (count == 0) return 0
    
    local_sum = 0
    for (i = 1; i <= count; i++) {
        local_sum += numbers[i]
    }
    return local_sum / count
}

function validate_email(email) {
    return email ~ /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/
}'
```

**ğŸ“‹ æ³¨é‡Šè§„èŒƒ**

```bash
#!/usr/bin/awk -f

#

# æ–‡ä»¶åï¼šlog_analyzer.awk

# ä½œè€…ï¼šè¿ç»´å›¢é˜Ÿ

# åˆ›å»ºæ—¶é—´ï¼š2024-03-18

# ç‰ˆæœ¬ï¼šv2.1

# æè¿°ï¼šåˆ†æWebæœåŠ¡å™¨è®¿é—®æ—¥å¿—ï¼Œç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š

# ç”¨æ³•ï¼šawk -f log_analyzer.awk access.log

#


BEGIN {
#    # ===========================================
#    # å…¨å±€å˜é‡åˆå§‹åŒ–
#    # ===========================================
    
#    # ç»Ÿè®¡è®¡æ•°å™¨
    total_requests = 0      # æ€»è¯·æ±‚æ•°
    error_requests = 0      # é”™è¯¯è¯·æ±‚æ•°
    
#    # é…ç½®å‚æ•°
    REPORT_INTERVAL = 3600  # æŠ¥å‘Šé—´éš”ï¼ˆç§’ï¼‰
    ERROR_THRESHOLD = 100   # é”™è¯¯é˜ˆå€¼
    
    print "ğŸ“Š å¼€å§‹åˆ†æè®¿é—®æ—¥å¿—..."
}

# ===========================================  

# ä¸»å¤„ç†é€»è¾‘ï¼šè§£ææ¯è¡Œæ—¥å¿—

# ===========================================

{
#    # æå–å…³é”®ä¿¡æ¯
    client_ip = $1              # å®¢æˆ·ç«¯IP
    timestamp = $4              # è®¿é—®æ—¶é—´
    request_method = $6         # è¯·æ±‚æ–¹æ³•
    request_url = $7            # è¯·æ±‚URL  
    response_code = $9          # å“åº”çŠ¶æ€ç 
    response_size = $10         # å“åº”å¤§å°
    
#    # åŸºç¡€ç»Ÿè®¡
    total_requests++
    
#    # é”™è¯¯è¯·æ±‚ç»Ÿè®¡
    if (response_code >= 400) {
        error_requests++
        error_details[response_code]++
        
#        # è®°å½•é”™è¯¯è¯¦æƒ…ç”¨äºè°ƒè¯•
        if (response_code >= 500) {
            print "ğŸ”´ æœåŠ¡å™¨é”™è¯¯ï¼š" client_ip " " request_url > "server_errors.log"
        }
    }
    
#    # æµé‡ç»Ÿè®¡ï¼ˆé¿å…æ— æ•ˆæ•°æ®ï¼‰
    if (response_size ~ /^[0-9]+$/) {
        total_traffic += response_size
    }
}

END {
#    # ===========================================
#    # ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
#    # ===========================================
    
    print "\nğŸ“ˆ è®¿é—®æ—¥å¿—åˆ†ææŠ¥å‘Š"
    print "=" x 50
    
    printf "æ€»è¯·æ±‚æ•°ï¼š%,d\n", total_requests
    printf "é”™è¯¯è¯·æ±‚ï¼š%,d (%.2f%%)\n", error_requests, (error_requests/total_requests*100)
    printf "æ€»æµé‡ï¼š%.2f MB\n", total_traffic/1024/1024
    
#    # é”™è¯¯è¯¦æƒ…
    if (error_requests > 0) {
        print "\nğŸ” é”™è¯¯çŠ¶æ€ç åˆ†å¸ƒï¼š"
        for (code in error_details) {
            printf "  %s: %dæ¬¡\n", code, error_details[code]
        }
    }
}
```

### 4.2 å‡½æ•°è®¾è®¡æ¨¡å¼



**ğŸ”§ é€šç”¨å·¥å…·å‡½æ•°åº“**

```bash
# utils.awk - é€šç”¨å·¥å…·å‡½æ•°åº“


# å­—ç¬¦ä¸²å¤„ç†å‡½æ•°

function trim(str) {
#    # å»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦
    gsub(/^[ \t\n\r]+|[ \t\n\r]+$/, "", str)
    return str
}

function is_empty(str) {
#    # æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º
    return (str == "" || str ~ /^[ \t\n\r]*$/)
}

function safe_substr(str, start, length) {
#    # å®‰å…¨çš„å­—ç¬¦ä¸²æˆªå–
    if (start < 1) start = 1
    if (start > length(str)) return ""
    if (length == "") return substr(str, start)
    return substr(str, start, length)
}

# æ•°å€¼å¤„ç†å‡½æ•°

function is_numeric(value) {
#    # æ£€æŸ¥æ˜¯å¦ä¸ºæ•°å­—
    return (value ~ /^-?[0-9]+(\.[0-9]+)?([eE][+-]?[0-9]+)?$/)
}

function safe_divide(numerator, denominator) {
#    # å®‰å…¨é™¤æ³•ï¼Œé¿å…é™¤é›¶é”™è¯¯
    if (denominator == 0) {
        print "âš ï¸  è­¦å‘Šï¼šé™¤é›¶æ“ä½œ" > "/dev/stderr"
        return 0
    }
    return numerator / denominator
}

# æ•°ç»„å¤„ç†å‡½æ•°

function array_length(arr,    count, i) {
#    # è®¡ç®—æ•°ç»„é•¿åº¦ï¼ˆå…³è”æ•°ç»„ï¼‰
    count = 0
    for (i in arr) count++
    return count
}

function array_max(arr,    max_val, i) {
#    # æ‰¾å‡ºæ•°ç»„ä¸­çš„æœ€å¤§å€¼
    max_val = ""
    for (i in arr) {
        if (max_val == "" || arr[i] > max_val) {
            max_val = arr[i]
        }
    }
    return max_val
}

# æ—¶é—´å¤„ç†å‡½æ•°

function parse_timestamp(timestamp) {
#    # è§£ææ—¶é—´æˆ³ [18/Mar/2024:14:30:22 +0800]
    gsub(/[\[\]]/, "", timestamp)
    return timestamp
}

function format_duration(seconds) {
#    # æ ¼å¼åŒ–æ—¶é—´é•¿åº¦
    if (seconds < 60) {
        return seconds "ç§’"
    } else if (seconds < 3600) {
        return int(seconds/60) "åˆ†" (seconds%60) "ç§’"
    } else {
        return int(seconds/3600) "å°æ—¶" int((seconds%3600)/60) "åˆ†"
    }
}
```

---

## 5. âœ… æµ‹è¯•éªŒè¯æ–¹æ³•



### 5.1 å•å…ƒæµ‹è¯•æ¡†æ¶



**ğŸ§ª awkè„šæœ¬æµ‹è¯•ç­–ç•¥**

```bash
#!/bin/bash

# test_runner.sh - awkè„šæœ¬æµ‹è¯•è¿è¡Œå™¨


# æµ‹è¯•é…ç½®

TEST_DIR="tests"
SCRIPT_FILE="log_analyzer.awk"

echo "ğŸ§ª å¼€å§‹è¿è¡Œawkè„šæœ¬æµ‹è¯•å¥—ä»¶"
echo "=" x 50

# æµ‹è¯•ç”¨ä¾‹1ï¼šåŸºæœ¬åŠŸèƒ½æµ‹è¯•

run_test() {
    local test_name="$1"
    local input_file="$2"
    local expected_output="$3"
    
    echo "ğŸ” è¿è¡Œæµ‹è¯•ï¼š$test_name"
    
#    # æ‰§è¡Œawkè„šæœ¬
    actual_output=$(awk -f "$SCRIPT_FILE" "$input_file" 2>/dev/null)
    
#    # æ¯”è¾ƒç»“æœ
    if [ "$actual_output" = "$expected_output" ]; then
        echo "  âœ… é€šè¿‡"
        ((passed++))
    else {
        echo "  âŒ å¤±è´¥"
        echo "  æœŸæœ›è¾“å‡ºï¼š$expected_output"
        echo "  å®é™…è¾“å‡ºï¼š$actual_output"
        ((failed++))
    }
    ((total++))
}

# åˆ›å»ºæµ‹è¯•æ•°æ®

create_test_data() {
#    # æ­£å¸¸è®¿é—®æ—¥å¿—
    cat > "$TEST_DIR/normal.log" << EOF
192.168.1.1 - - [18/Mar/2024:14:30:22 +0800] "GET /index.html HTTP/1.1" 200 1234
192.168.1.2 - - [18/Mar/2024:14:30:23 +0800] "GET /about.html HTTP/1.1" 200 2345
EOF

#    # åŒ…å«é”™è¯¯çš„æ—¥å¿—
    cat > "$TEST_DIR/errors.log" << EOF
192.168.1.3 - - [18/Mar/2024:14:30:24 +0800] "GET /missing.html HTTP/1.1" 404 567
192.168.1.4 - - [18/Mar/2024:14:30:25 +0800] "POST /api/data HTTP/1.1" 500 890
EOF

#    # ç©ºæ–‡ä»¶æµ‹è¯•
    touch "$TEST_DIR/empty.log"
}

# æ‰§è¡Œæµ‹è¯•å¥—ä»¶

passed=0
failed=0
total=0

mkdir -p "$TEST_DIR"
create_test_data

# åŸºæœ¬åŠŸèƒ½æµ‹è¯•

run_test "æ­£å¸¸æ—¥å¿—è§£æ" "$TEST_DIR/normal.log" "æ€»è¯·æ±‚æ•°ï¼š2"
run_test "é”™è¯¯æ—¥å¿—è¯†åˆ«" "$TEST_DIR/errors.log" "é”™è¯¯è¯·æ±‚ï¼š2"
run_test "ç©ºæ–‡ä»¶å¤„ç†" "$TEST_DIR/empty.log" "æ€»è¯·æ±‚æ•°ï¼š0"

# è¾¹ç•Œæ¡ä»¶æµ‹è¯•

echo "192.168.1.1" > "$TEST_DIR/malformed.log"
run_test "æ ¼å¼é”™è¯¯æ—¥å¿—" "$TEST_DIR/malformed.log" "æ ¼å¼é”™è¯¯ï¼š1"

# æµ‹è¯•æŠ¥å‘Š

echo ""
echo "ğŸ“Š æµ‹è¯•ç»“æœç»Ÿè®¡"
echo "=" x 30
echo "æ€»æµ‹è¯•ï¼š$total"
echo "é€šè¿‡ï¼š$passed"
echo "å¤±è´¥ï¼š$failed"

if [ $failed -eq 0 ]; then
    echo "ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼"
    exit 0
else
    echo "âŒ æœ‰æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥"
    exit 1
fi
```

### 5.2 æ€§èƒ½åŸºå‡†æµ‹è¯•



**âš¡ æ€§èƒ½æµ‹è¯•å·¥å…·**

```bash
#!/bin/bash

# benchmark.sh - awkè„šæœ¬æ€§èƒ½åŸºå‡†æµ‹è¯•


echo "âš¡ awkè„šæœ¬æ€§èƒ½åŸºå‡†æµ‹è¯•"
echo "=" x 40

# ç”Ÿæˆæµ‹è¯•æ•°æ®

generate_test_data() {
    local size="$1"
    local filename="$2"
    
    echo "ğŸ“ ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼š$size è¡Œ"
    
    for ((i=1; i<=size; i++)); do
        echo "192.168.1.$((i%255+1)) - - [18/Mar/2024:14:30:$((i%60)) +0800] \"GET /page$i.html HTTP/1.1\" $((200 + i%300)) $((i*100))"
    done > "$filename"
}

# æ€§èƒ½æµ‹è¯•å‡½æ•°

benchmark_script() {
    local script="$1"
    local data_file="$2"
    local description="$3"
    
    echo "ğŸ” æµ‹è¯•ï¼š$description"
    
#    # è®°å½•å¼€å§‹æ—¶é—´
    start_time=$(date +%s.%N)
    
#    # æ‰§è¡Œè„šæœ¬
    awk -f "$script" "$data_file" > /dev/null
    
#    # è®¡ç®—æ‰§è¡Œæ—¶é—´
    end_time=$(date +%s.%N)
    execution_time=$(echo "$end_time - $start_time" | bc)
    
    echo "  â±ï¸  æ‰§è¡Œæ—¶é—´ï¼š${execution_time}ç§’"
    
#    # å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆç®€åŒ–ï¼‰
    memory_usage=$(ps -o pid,vsz,rss -p $$ | tail -n1 | awk '{print $3}')
    echo "  ğŸ§  å†…å­˜ä½¿ç”¨ï¼š${memory_usage}KB"
    
    echo ""
}

# åˆ›å»ºæµ‹è¯•è„šæœ¬å˜ç§

cat > optimized.awk << 'EOF'
# ä¼˜åŒ–ç‰ˆæœ¬ï¼šå‡å°‘æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨

{
    if (index($9, "40") == 1 || index($9, "50") == 1) {
        errors++
    }
    total++
}
END { print "é”™è¯¯ç‡ï¼š" (errors/total*100) "%" }
EOF

cat > standard.awk << 'EOF'
# æ ‡å‡†ç‰ˆæœ¬ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼

{
    if ($9 ~ /^[45]/) {
        errors++
    }
    total++
}
END { print "é”™è¯¯ç‡ï¼š" (errors/total*100) "%" }
EOF

# è¿è¡ŒåŸºå‡†æµ‹è¯•

test_sizes=(1000 10000 100000)

for size in "${test_sizes[@]}"; do
    echo "ğŸ“Š æµ‹è¯•æ•°æ®è§„æ¨¡ï¼š$size è¡Œ"
    echo "-" x 30
    
    data_file="test_${size}.log"
    generate_test_data "$size" "$data_file"
    
    benchmark_script "standard.awk" "$data_file" "æ ‡å‡†å®ç°"
    benchmark_script "optimized.awk" "$data_file" "ä¼˜åŒ–å®ç°"
    
    echo ""
done

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶

rm -f test_*.log *.awk
```

---

## 6. ğŸš€ éƒ¨ç½²ç­–ç•¥



### 6.1 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è§„èŒƒ



**ğŸ“¦ éƒ¨ç½²åŒ…ç»“æ„**

```
awk-scripts-v1.0/
â”œâ”€â”€ scripts/                 # ä¸»è¦è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ log_analyzer.awk    # æ—¥å¿—åˆ†æå™¨
â”‚   â”œâ”€â”€ data_processor.awk  # æ•°æ®å¤„ç†å™¨
â”‚   â””â”€â”€ utils.awk           # å·¥å…·å‡½æ•°åº“
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ settings.conf       # å…¨å±€è®¾ç½®
â”‚   â””â”€â”€ patterns.conf       # æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_data/         # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ test_suite.sh      # æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md          # ä½¿ç”¨è¯´æ˜
â”‚   â””â”€â”€ API.md             # æ¥å£æ–‡æ¡£
â”œâ”€â”€ deployment/             # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ install.sh         # å®‰è£…è„šæœ¬
â”‚   â”œâ”€â”€ uninstall.sh       # å¸è½½è„šæœ¬
â”‚   â””â”€â”€ update.sh          # æ›´æ–°è„šæœ¬
â””â”€â”€ CHANGELOG.md           # å˜æ›´æ—¥å¿—
```

**ğŸ”§ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬**

```bash
#!/bin/bash

# install.sh - awkè„šæœ¬è‡ªåŠ¨åŒ–éƒ¨ç½²


set -e  # å‡ºé”™ç«‹å³åœæ­¢

# é…ç½®å‚æ•°

INSTALL_DIR="/opt/awk-tools"
BIN_DIR="/usr/local/bin"
CONFIG_DIR="/etc/awk-tools"
LOG_DIR="/var/log/awk-tools"
USER="awk-tools"

echo "ğŸš€ å¼€å§‹éƒ¨ç½²awkå·¥å…·å¥—ä»¶"
echo "=" x 40

# å‰ç½®æ£€æŸ¥

preflight_check() {
    echo "ğŸ” æ‰§è¡Œå‰ç½®æ£€æŸ¥..."
    
#    # æ£€æŸ¥ç³»ç»Ÿè¦æ±‚
    if ! command -v awk &> /dev/null; then
        echo "âŒ é”™è¯¯ï¼šç³»ç»Ÿæœªå®‰è£…awk"
        exit 1
    fi
    
#    # æ£€æŸ¥æƒé™
    if [[ $EUID -ne 0 ]]; then
        echo "âŒ é”™è¯¯ï¼šéœ€è¦rootæƒé™"
        exit 1
    fi
    
    echo "âœ… å‰ç½®æ£€æŸ¥é€šè¿‡"
}

# åˆ›å»ºç”¨æˆ·å’Œç›®å½•

setup_environment() {
    echo "ğŸ—ï¸  è®¾ç½®ç¯å¢ƒ..."
    
#    # åˆ›å»ºä¸“ç”¨ç”¨æˆ·
    if ! id "$USER" &>/dev/null; then
        useradd -r -s /bin/false -d "$INSTALL_DIR" "$USER"
        echo "âœ… åˆ›å»ºç”¨æˆ·ï¼š$USER"
    fi
    
#    # åˆ›å»ºç›®å½•ç»“æ„
    mkdir -p "$INSTALL_DIR"/{scripts,logs}
    mkdir -p "$CONFIG_DIR"
    mkdir -p "$LOG_DIR"
    
    echo "âœ… ç›®å½•ç»“æ„åˆ›å»ºå®Œæˆ"
}

# å®‰è£…æ–‡ä»¶

install_files() {
    echo "ğŸ“ å®‰è£…æ–‡ä»¶..."
    
#    # å¤åˆ¶è„šæœ¬æ–‡ä»¶
    cp scripts/*.awk "$INSTALL_DIR/scripts/"
    chmod +x "$INSTALL_DIR/scripts/"*.awk
    
#    # å¤åˆ¶é…ç½®æ–‡ä»¶
    cp config/* "$CONFIG_DIR/"
    
#    # åˆ›å»ºå¯åŠ¨è„šæœ¬
    cat > "$BIN_DIR/awk-analyzer" << EOF
#!/bin/bash

# awkå·¥å…·å¯åŠ¨è„šæœ¬

exec awk -f "$INSTALL_DIR/scripts/log_analyzer.awk" "\$@"
EOF
    chmod +x "$BIN_DIR/awk-analyzer"
    
#    # è®¾ç½®æƒé™
    chown -R "$USER:$USER" "$INSTALL_DIR"
    chown -R "$USER:$USER" "$LOG_DIR"
    
    echo "âœ… æ–‡ä»¶å®‰è£…å®Œæˆ"
}

# é…ç½®ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰

setup_service() {
    echo "âš™ï¸  é…ç½®ç³»ç»ŸæœåŠ¡..."
    
    cat > /etc/systemd/system/awk-monitor.service << EOF
[Unit]
Description=AWK Log Monitor
After=network.target

[Service]
Type=simple
User=$USER
Group=$USER
WorkingDirectory=$INSTALL_DIR
ExecStart=$BIN_DIR/awk-analyzer --daemon
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF
    
    systemctl daemon-reload
    systemctl enable awk-monitor.service
    
    echo "âœ… ç³»ç»ŸæœåŠ¡é…ç½®å®Œæˆ"
}

# éªŒè¯å®‰è£…

verify_installation() {
    echo "ğŸ” éªŒè¯å®‰è£…..."
    
#    # æµ‹è¯•å‘½ä»¤å¯ç”¨æ€§
    if command -v awk-analyzer &> /dev/null; then
        echo "âœ… å‘½ä»¤è¡Œå·¥å…·å¯ç”¨"
    else
        echo "âŒ å‘½ä»¤è¡Œå·¥å…·å®‰è£…å¤±è´¥"
        exit 1
    fi
    
#    # æµ‹è¯•åŸºæœ¬åŠŸèƒ½
    echo "test line" | awk-analyzer &> /dev/null
    if [ $? -eq 0 ]; then
        echo "âœ… åŸºæœ¬åŠŸèƒ½æ­£å¸¸"
    else
        echo "âŒ åŸºæœ¬åŠŸèƒ½æµ‹è¯•å¤±è´¥"
        exit 1
    fi
}

# ä¸»éƒ¨ç½²æµç¨‹

main() {
    preflight_check
    setup_environment  
    install_files
    setup_service
    verify_installation
    
    echo ""
    echo "ğŸ‰ awkå·¥å…·å¥—ä»¶éƒ¨ç½²æˆåŠŸï¼"
    echo ""
    echo "ğŸ“– ä½¿ç”¨æ–¹æ³•ï¼š"
    echo "  awk-analyzer /var/log/nginx/access.log"
    echo ""
    echo "ğŸ“‚ å®‰è£…ä½ç½®ï¼š"
    echo "  ç¨‹åºç›®å½•ï¼š$INSTALL_DIR"
    echo "  é…ç½®ç›®å½•ï¼š$CONFIG_DIR"  
    echo "  æ—¥å¿—ç›®å½•ï¼š$LOG_DIR"
    echo ""
    echo "ğŸ”§ ç®¡ç†å‘½ä»¤ï¼š"
    echo "  systemctl start awk-monitor    # å¯åŠ¨æœåŠ¡"
    echo "  systemctl status awk-monitor   # æŸ¥çœ‹çŠ¶æ€"
}

main "$@"
```

### 6.2 é…ç½®ç®¡ç†



**âš™ï¸ çµæ´»çš„é…ç½®ç³»ç»Ÿ**

```bash
# settings.conf - å…¨å±€é…ç½®æ–‡ä»¶

# AWKå·¥å…·å¥—ä»¶é…ç½®æ–‡ä»¶

# ç‰ˆæœ¬ï¼šv1.0


[global]
# å…¨å±€è®¾ç½®

debug_mode=false
max_memory_mb=1024
temp_dir=/tmp/awk-tools

[log_analyzer]  
# æ—¥å¿—åˆ†æå™¨è®¾ç½®

error_threshold=100
warning_threshold=50
report_interval=3600
output_format=json

[data_processor]
# æ•°æ®å¤„ç†å™¨è®¾ç½®  

batch_size=10000
parallel_workers=4
timeout_seconds=300

[alerts]
# å‘Šè­¦è®¾ç½®

email_enabled=true
email_recipients=admin@company.com,ops@company.com
webhook_url=https://hooks.slack.com/services/xxx

# patterns.conf - æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼

# å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åº“


[ip_patterns]
ipv4=^([0-9]{1,3}\.){3}[0-9]{1,3}$
private_ip=^(10\.|192\.168\.|172\.(1[6-9]|2[0-9]|3[01])\.)

[log_patterns]
apache_combined=^(\S+) \S+ \S+ \[([^\]]+)\] "([^"]*)" (\d+) (\d+) "([^"]*)" "([^"]*)"$
nginx_access=^(\S+) - - \[([^\]]+)\] "(\S+) (\S+) (\S+)" (\d+) (\d+)

[error_patterns]
java_exception=Exception in thread
python_traceback=Traceback \(most recent call last\)
sql_error=SQL Error|MySQL Error
```

**ğŸ“Š é…ç½®åŠ è½½å™¨**

```bash
# config_loader.awk - é…ç½®æ–‡ä»¶åŠ è½½å™¨

function load_config(config_file,    line, section, key, value) {
    current_section = "global"
    
    while ((getline line < config_file) > 0) {
#        # è·³è¿‡æ³¨é‡Šå’Œç©ºè¡Œ
        if (line ~ /^#/ || line ~ /^$/) continue
        
#        # è§£æsection
        if (line ~ /^\[.*\]$/) {
            gsub(/[\[\]]/, "", line)
            current_section = line
            continue
        }
        
#        # è§£ækey=value
        if (line ~ /=/) {
            split(line, kv, "=")
            key = trim(kv[1])
            value = trim(kv[2])
            
            config[current_section][key] = value
        }
    }
    close(config_file)
}

# ä½¿ç”¨é…ç½®çš„ç¤ºä¾‹

BEGIN {
    config_file = "/etc/awk-tools/settings.conf"
    load_config(config_file)
    
#    # è¯»å–é…ç½®å€¼
    debug_mode = (config["global"]["debug_mode"] == "true")
    error_threshold = config["log_analyzer"]["error_threshold"]
    
    if (debug_mode) {
        print "ğŸ› è°ƒè¯•æ¨¡å¼å·²å¯ç”¨"
        print "é”™è¯¯é˜ˆå€¼ï¼š" error_threshold
    }
}
```

---

## 7. ğŸ› ï¸ ç»´æŠ¤æœ€ä½³å®è·µ



### 7.1 æ—¥å¿—è®°å½•ä¸ç›‘æ§



**ğŸ“Š å®Œæ•´çš„ç›‘æ§ä½“ç³»**

```bash
# monitor.awk - ç›‘æ§å’Œæ—¥å¿—è®°å½•

BEGIN {
#    # åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    log_file = "/var/log/awk-tools/app.log"
    error_log = "/var/log/awk-tools/error.log"
    
#    # è®°å½•ç¨‹åºå¯åŠ¨
    log_message("INFO", "ç¨‹åºå¯åŠ¨", "ç‰ˆæœ¬: v1.0")
}

function log_message(level, message, details) {
    timestamp = strftime("%Y-%m-%d %H:%M:%S", systime())
    
#    # æ ¼å¼åŒ–æ—¥å¿—æ¶ˆæ¯
    log_entry = timestamp " [" level "] " message
    if (details != "") {
        log_entry = log_entry " - " details
    }
    
#    # å†™å…¥ç›¸åº”æ—¥å¿—æ–‡ä»¶
    if (level == "ERROR" || level == "FATAL") {
        print log_entry >> error_log
        fflush(error_log)
    }
    print log_entry >> log_file
    fflush(log_file)
    
#    # ä¸¥é‡é”™è¯¯æ—¶å‘é€å‘Šè­¦
    if (level == "FATAL") {
        send_alert("FATAL", message, details)
    }
}

function send_alert(level, message, details) {
#    # è¿™é‡Œå¯ä»¥é›†æˆé‚®ä»¶ã€Slackã€é’‰é’‰ç­‰å‘Šè­¦æ¸ é“
    alert_cmd = "echo 'å‘Šè­¦: " level " - " message "' | mail -s 'AWKå·¥å…·å‘Šè­¦' admin@company.com"
    system(alert_cmd)
}

# æ€§èƒ½ç›‘æ§

function monitor_performance(    start_time, memory_usage) {
    if (NR % 10000 == 0) {  # æ¯10000è¡Œè®°å½•ä¸€æ¬¡
        current_time = systime()
        
        if (start_time == "") {
            start_time = current_time
        }
        
        elapsed = current_time - start_time
        rps = NR / elapsed  # æ¯ç§’å¤„ç†è¡Œæ•°
        
        log_message("INFO", "æ€§èƒ½ç›‘æ§", "å·²å¤„ç†: " NR " è¡Œ, é€Ÿåº¦: " rps " è¡Œ/ç§’")
        
#        # å†…å­˜ä½¿ç”¨ç›‘æ§ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        if (length(memory_arrays) > 100000) {
            log_message("WARN", "å†…å­˜ä½¿ç”¨è¿‡é«˜", "æ•°ç»„é•¿åº¦: " length(memory_arrays))
        }
    }
}

{
#    # ä¸»å¤„ç†é€»è¾‘
    process_line($0)
    
#    # å®šæœŸç›‘æ§
    monitor_performance()
}

function process_line(line) {
#    # å®é™…ä¸šåŠ¡é€»è¾‘
    try {
#        # å¤„ç†é€»è¾‘
        business_logic(line)
    } catch (error) {
        log_message("ERROR", "å¤„ç†å¤±è´¥", "è¡Œå·: " NR ", é”™è¯¯: " error)
        error_count++
    }
}

END {
#    # ç¨‹åºç»“æŸç»Ÿè®¡
    total_time = systime() - program_start_time
    
    log_message("INFO", "ç¨‹åºç»“æŸ", 
                "æ€»è¡Œæ•°: " NR 
                ", é”™è¯¯æ•°: " error_count 
                ", è€—æ—¶: " total_time " ç§’")
    
#    # ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
    generate_performance_report()
}
```

### 7.2 ç‰ˆæœ¬æ§åˆ¶ä¸å‘å¸ƒç®¡ç†



**ğŸ”„ ç‰ˆæœ¬å‘å¸ƒæµç¨‹**

```bash
#!/bin/bash

# release.sh - ç‰ˆæœ¬å‘å¸ƒç®¡ç†è„šæœ¬


set -e

# ç‰ˆæœ¬ä¿¡æ¯

CURRENT_VERSION=$(cat VERSION)
NEW_VERSION="$1"

if [ -z "$NEW_VERSION" ]; then
    echo "âŒ è¯·æŒ‡å®šæ–°ç‰ˆæœ¬å·"
    echo "ç”¨æ³•: $0 <version>"
    exit 1
fi

echo "ğŸ”„ å‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬ï¼š$CURRENT_VERSION â†’ $NEW_VERSION"

# å‰ç½®æ£€æŸ¥

preflight_checks() {
    echo "ğŸ” æ‰§è¡Œå‘å¸ƒå‰æ£€æŸ¥..."
    
#    # æ£€æŸ¥gitçŠ¶æ€
    if [ -n "$(git status --porcelain)" ]; then
        echo "âŒ å·¥ä½œç›®å½•ä¸å¹²å‡€ï¼Œè¯·å…ˆæäº¤æ‰€æœ‰æ›´æ”¹"
        exit 1
    fi
    
#    # è¿è¡Œæµ‹è¯•å¥—ä»¶
    echo "ğŸ§ª è¿è¡Œæµ‹è¯•å¥—ä»¶..."
    if ! ./tests/test_suite.sh; then
        echo "âŒ æµ‹è¯•å¤±è´¥ï¼Œæ— æ³•å‘å¸ƒ"
        exit 1
    fi
    
#    # ä»£ç è´¨é‡æ£€æŸ¥
    echo "ğŸ“ æ‰§è¡Œä»£ç è´¨é‡æ£€æŸ¥..."
    if ! ./scripts/code_quality_check.sh; then
        echo "âŒ ä»£ç è´¨é‡æ£€æŸ¥æœªé€šè¿‡"
        exit 1
    fi
    
    echo "âœ… å‘å¸ƒå‰æ£€æŸ¥é€šè¿‡"
}

# ç”Ÿæˆå˜æ›´æ—¥å¿—

generate_changelog() {
    echo "ğŸ“– ç”Ÿæˆå˜æ›´æ—¥å¿—..."
    
#    # è·å–ä¸Šä¸€ä¸ªtag
    LAST_TAG=$(git describe --tags --abbrev=0)
    
#    # ç”Ÿæˆå˜æ›´æ—¥å¿—æ¡ç›®
    cat >> CHANGELOG.md << EOF

# [$NEW_VERSION] - $(date +%Y-%m-%d)



## æ–°å¢åŠŸèƒ½


$(git log --pretty=format:"- %s" --grep="feat:" $LAST_TAG..HEAD)

## é—®é¢˜ä¿®å¤  


$(git log --pretty=format:"- %s" --grep="fix:" $LAST_TAG..HEAD)

## ä¼˜åŒ–æ”¹è¿›


$(git log --pretty=format:"- %s" --grep="perf:\|refactor:" $LAST_TAG..HEAD)

EOF

    echo "âœ… å˜æ›´æ—¥å¿—å·²æ›´æ–°"
}

# æ›´æ–°ç‰ˆæœ¬æ–‡ä»¶

update_version_files() {
    echo "ğŸ”¢ æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯..."
    
#    # æ›´æ–°VERSIONæ–‡ä»¶
    echo "$NEW_VERSION" > VERSION
    
#    # æ›´æ–°è„šæœ¬ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯
    sed -i "s/VERSION=\".*\"/VERSION=\"$NEW_VERSION\"/g" scripts/*.awk
    
    echo "âœ… ç‰ˆæœ¬ä¿¡æ¯å·²æ›´æ–°"
}

# æ„å»ºå‘å¸ƒåŒ…

build_release() {
    echo "ğŸ“¦ æ„å»ºå‘å¸ƒåŒ…..."
    
    RELEASE_DIR="releases/awk-tools-$NEW_VERSION"
    mkdir -p "$RELEASE_DIR"
    
#    # å¤åˆ¶æ–‡ä»¶
    cp -r scripts/ config/ docs/ "$RELEASE_DIR/"
    cp README.md LICENSE VERSION "$RELEASE_DIR/"
    
#    # åˆ›å»ºå®‰è£…è„šæœ¬
    cp deployment/install.sh "$RELEASE_DIR/"
    
#    # æ‰“åŒ…
    cd releases/
    tar -czf "awk-tools-$NEW_VERSION.tar.gz" "awk-tools-$NEW_VERSION"
    
    echo "âœ… å‘å¸ƒåŒ…æ„å»ºå®Œæˆï¼šreleases/awk-tools-$NEW_VERSION.tar.gz"
}

# åˆ›å»ºGitæ ‡ç­¾

create_git_tag() {
    echo "ğŸ·ï¸  åˆ›å»ºGitæ ‡ç­¾..."
    
    git add .
    git commit -m "release: v$NEW_VERSION"
    git tag -a "v$NEW_VERSION" -m "Release version $NEW_VERSION"
    
    echo "âœ… Gitæ ‡ç­¾å·²åˆ›å»º"
}

# ä¸»å‘å¸ƒæµç¨‹

main() {
    preflight_checks
    generate_changelog
    update_version_files
    build_release  
    create_git_tag
    
    echo ""
    echo "ğŸ‰ ç‰ˆæœ¬ $NEW_VERSION å‘å¸ƒæˆåŠŸï¼"
    echo ""
    echo "ğŸ“‹ åç»­æ“ä½œï¼š"
    echo "1. æ¨é€åˆ°è¿œç¨‹ä»“åº“: git push origin main --tags"  
    echo "2. ä¸Šä¼ å‘å¸ƒåŒ…åˆ°æœåŠ¡å™¨"
    echo "3. æ›´æ–°æ–‡æ¡£ç½‘ç«™"
    echo "4. å‘é€å‘å¸ƒé€šçŸ¥"
}

main "$@"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„å®æˆ˜æŠ€èƒ½



**ğŸ¯ ä¼ä¸šçº§åº”ç”¨å¼€å‘**
```
æ ¸å¿ƒèƒ½åŠ›æ¸…å•ï¼š
âœ… æ—¥å¿—åˆ†æç³»ç»Ÿè®¾è®¡ä¸å®ç°
âœ… æ•°æ®è´¨é‡æ£€æŸ¥ä¸æ¸…æ´—æµç¨‹
âœ… ç³»ç»Ÿç›‘æ§ä¸å‘Šè­¦æœºåˆ¶
âœ… å¤§æ•°æ®å¤„ç†æ€§èƒ½ä¼˜åŒ–
âœ… é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ¢å¤
```

**âš¡ æ€§èƒ½ä¼˜åŒ–ç²¾è¦**
```
ä¼˜åŒ–ç­–ç•¥ä¼˜å…ˆçº§ï¼š
ğŸ”¸ ç®—æ³•ä¼˜åŒ– > ä»£ç ä¼˜åŒ– > ç¡¬ä»¶ä¼˜åŒ–
ğŸ”¸ å‡å°‘æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨é¢‘ç‡
ğŸ”¸ åˆç†æ§åˆ¶æ•°ç»„å¤§å°å’Œå†…å­˜ä½¿ç”¨
ğŸ”¸ é‡‡ç”¨åˆ†å—å¤„ç†å¤„ç†å¤§æ–‡ä»¶
ğŸ”¸ é¿å…ä¸å¿…è¦çš„å­—ç¬¦ä¸²æ“ä½œ
```

### 8.2 ä¼ä¸šçº§å¼€å‘æœ€ä½³å®è·µ



**ğŸ“ ä»£ç è´¨é‡ä¿éšœ**
```
å¿…å¤‡è¦ç´ ï¼š
â€¢ æ¸…æ™°çš„å‘½åè§„èŒƒå’Œæ³¨é‡Šæ ‡å‡†
â€¢ å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ç®¡ç†
â€¢ æ¨¡å—åŒ–çš„å‡½æ•°è®¾è®¡å’Œä»£ç å¤ç”¨
â€¢ å…¨é¢çš„æµ‹è¯•è¦†ç›–å’Œæ€§èƒ½åŸºå‡†
â€¢ è§„èŒƒçš„ç‰ˆæœ¬æ§åˆ¶å’Œå‘å¸ƒæµç¨‹
```

**ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡**
```
è®¾è®¡åŸåˆ™ï¼š
â€¢ å•ä¸€èŒè´£ï¼šæ¯ä¸ªè„šæœ¬ä¸“æ³¨è§£å†³ä¸€ä¸ªé—®é¢˜
â€¢ å¯é…ç½®æ€§ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶è¡Œä¸º
â€¢ å¯æ‰©å±•æ€§ï¼šæ”¯æŒæ’ä»¶å’Œè‡ªå®šä¹‰æ‰©å±•
â€¢ å¯ç»´æŠ¤æ€§ï¼šæ¸…æ™°çš„æ—¥å¿—å’Œç›‘æ§ä½“ç³»
â€¢ å¯é æ€§ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼ä½“ç°



**ğŸ”§ æ—¥å¸¸è¿ç»´åœºæ™¯**
- **æ—¥å¿—åˆ†æ**ï¼šå¿«é€Ÿå®šä½ç³»ç»Ÿé—®é¢˜å’Œæ€§èƒ½ç“¶é¢ˆ
- **æ•°æ®å¤„ç†**ï¼šæ‰¹é‡æ¸…æ´—å’Œè½¬æ¢å„ç§æ ¼å¼æ•°æ®
- **ç›‘æ§å‘Šè­¦**ï¼šå®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€å¼‚å¸¸æƒ…å†µ
- **æŠ¥è¡¨ç”Ÿæˆ**ï¼šè‡ªåŠ¨åŒ–ç”Ÿæˆå„ç±»ç»Ÿè®¡å’Œåˆ†ææŠ¥è¡¨
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šç»“åˆshellè„šæœ¬å®ç°è¿ç»´è‡ªåŠ¨åŒ–

**ğŸ’¼ ä¸šåŠ¡ä»·å€¼åˆ›é€ **
- **æ•ˆç‡æå‡**ï¼šè‡ªåŠ¨åŒ–æ›¿ä»£äººå·¥å¤„ç†ï¼Œæé«˜å·¥ä½œæ•ˆç‡
- **æˆæœ¬èŠ‚çº¦**ï¼šå‡å°‘äººåŠ›æŠ•å…¥ï¼Œé™ä½è¿ç»´æˆæœ¬
- **è´¨é‡ä¿è¯**ï¼šæ ‡å‡†åŒ–å¤„ç†æµç¨‹ï¼Œå‡å°‘äººä¸ºé”™è¯¯
- **å¿«é€Ÿå“åº”**ï¼šå®æ—¶ç›‘æ§å‘Šè­¦ï¼Œå¿«é€Ÿå‘ç°å’Œè§£å†³é—®é¢˜

**ğŸ“ å­¦ä¹ æˆé•¿è·¯å¾„**
```
èƒ½åŠ›æå‡é˜¶æ¢¯ï¼š
åˆçº§ â†’ æŒæ¡åŸºæœ¬è¯­æ³•å’Œç®€å•æ•°æ®å¤„ç†
ä¸­çº§ â†’ èƒ½å¤Ÿç¼–å†™å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®åˆ†æ
é«˜çº§ â†’ è®¾è®¡ä¼ä¸šçº§åº”ç”¨æ¶æ„å’Œæ€§èƒ½ä¼˜åŒ–
ä¸“å®¶ â†’ åˆ¶å®šæŠ€æœ¯è§„èŒƒå’Œæœ€ä½³å®è·µæ ‡å‡†
```

### 8.4 å…³é”®è®°å¿†è¦ç‚¹



**ğŸ”‘ æ ¸å¿ƒè®°å¿†å£è¯€**
```
"å®æˆ˜åº”ç”¨é‡å®æ•ˆï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯å…³é”®
é”™è¯¯å¤„ç†è¦å®Œå–„ï¼Œä»£ç è§„èŒƒä¸å¯å°‘  
æµ‹è¯•éªŒè¯ä¿è´¨é‡ï¼Œéƒ¨ç½²ç»´æŠ¤è¦è§„èŒƒ
ä¼ä¸šåº”ç”¨çœ‹å…¨å±€ï¼Œæœ€ä½³å®è·µåˆ›ä»·å€¼"
```

**ğŸ’¡ å®è·µæŒ‡å¯¼åŸåˆ™**
- **ä»å®é™…éœ€æ±‚å‡ºå‘**ï¼šä¸ä¸ºäº†æŠ€æœ¯è€ŒæŠ€æœ¯ï¼Œè§£å†³çœŸå®é—®é¢˜
- **æŒç»­æ”¹è¿›ä¼˜åŒ–**ï¼šä»£ç è¦ä¸æ–­é‡æ„å’Œä¼˜åŒ–æ€§èƒ½
- **æ³¨é‡ç”¨æˆ·ä½“éªŒ**ï¼šè€ƒè™‘ä½¿ç”¨è€…çš„ä¾¿åˆ©æ€§å’Œå¯ç†è§£æ€§  
- **å»ºç«‹æ ‡å‡†è§„èŒƒ**ï¼šå½¢æˆå¯å¤ç”¨çš„æ¨¡æ¿å’Œæœ€ä½³å®è·µ
- **ä¿æŒå­¦ä¹ æ›´æ–°**ï¼šè·Ÿè¿›æ–°æŠ€æœ¯å’Œæ–°å·¥å…·çš„å‘å±•

**æ ¸å¿ƒä»·å€¼**ï¼š
- awkä¸ä»…æ˜¯æ–‡æœ¬å¤„ç†å·¥å…·ï¼Œæ›´æ˜¯ä¼ä¸šçº§æ•°æ®å¤„ç†è§£å†³æ–¹æ¡ˆ
- æŒæ¡å®æˆ˜æŠ€èƒ½å’Œæœ€ä½³å®è·µï¼Œèƒ½å¤Ÿåˆ›é€ å®é™…çš„ä¸šåŠ¡ä»·å€¼
- è§„èŒƒåŒ–çš„å¼€å‘æµç¨‹æ˜¯ä¿è¯ä»£ç è´¨é‡å’Œé¡¹ç›®æˆåŠŸçš„å…³é”®
- æŒç»­å­¦ä¹ å’Œæ”¹è¿›æ˜¯æŠ€æœ¯äººå‘˜æˆé•¿çš„å¿…ç”±ä¹‹è·¯