---
title: 43ã€awkä¸ç³»ç»Ÿç®¡ç†é›†æˆ
---
## ğŸ“š ç›®å½•

1. [awkåœ¨ç³»ç»Ÿç®¡ç†ä¸­çš„è§’è‰²](#1-awkåœ¨ç³»ç»Ÿç®¡ç†ä¸­çš„è§’è‰²)
2. [ç³»ç»Ÿç›‘æ§ä¸æ€§èƒ½åˆ†æ](#2-ç³»ç»Ÿç›‘æ§ä¸æ€§èƒ½åˆ†æ)
3. [é…ç½®æ–‡ä»¶ç®¡ç†ä¸å¤„ç†](#3-é…ç½®æ–‡ä»¶ç®¡ç†ä¸å¤„ç†)
4. [æ‰¹é‡æ“ä½œè‡ªåŠ¨åŒ–](#4-æ‰¹é‡æ“ä½œè‡ªåŠ¨åŒ–)
5. [è¿ç»´æŠ¥å‘Šç”Ÿæˆ](#5-è¿ç»´æŠ¥å‘Šç”Ÿæˆ)
6. [æ•…éšœè¯Šæ–­è„šæœ¬å¼€å‘](#6-æ•…éšœè¯Šæ–­è„šæœ¬å¼€å‘)
7. [è‡ªåŠ¨åŒ–è¿ç»´é›†æˆ](#7-è‡ªåŠ¨åŒ–è¿ç»´é›†æˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ awkåœ¨ç³»ç»Ÿç®¡ç†ä¸­çš„è§’è‰²


### 1.1 ä¸ºä»€ä¹ˆé€‰æ‹©awkåšç³»ç»Ÿç®¡ç†


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> awkå°±åƒæ˜¯ç³»ç»Ÿç®¡ç†å‘˜çš„"ç‘å£«å†›åˆ€"ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†å„ç§æ–‡æœ¬æ ¼å¼çš„ç³»ç»Ÿæ•°æ®

**awkçš„ä¼˜åŠ¿ï¼š**
- **ğŸ“Š æ•°æ®å¤„ç†èƒ½åŠ›å¼º**ï¼šæ“…é•¿å¤„ç†åˆ—å¼æ•°æ®ï¼ˆæ—¥å¿—ã€é…ç½®ã€ç»Ÿè®¡ä¿¡æ¯ï¼‰
- **âš¡ æ‰§è¡Œæ•ˆç‡é«˜**ï¼šæ¯”shellè„šæœ¬å¤„ç†å¤§æ–‡ä»¶æ›´å¿«
- **ğŸ¯ è¯­æ³•ç®€æ´**ï¼šä¸€è¡Œå‘½ä»¤è§£å†³å¤æ‚é—®é¢˜
- **ğŸ”„ å®æ—¶å¤„ç†**ï¼šå¯ä»¥é…åˆç®¡é“å®ç°å®æ—¶ç›‘æ§

**å…¸å‹åº”ç”¨åœºæ™¯ï¼š**

| åœºæ™¯ç±»å‹ | **å…·ä½“åº”ç”¨** | **awkä¼˜åŠ¿** |
|---------|------------|------------|
| ğŸ” **æ—¥å¿—åˆ†æ** | `è§£æaccess.logã€error.log` | `çµæ´»çš„æ¨¡å¼åŒ¹é…å’Œå­—æ®µæå–` |
| ğŸ“ˆ **æ€§èƒ½ç›‘æ§** | `CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç»Ÿè®¡` | `æ•°å€¼è®¡ç®—å’ŒæŠ¥è¡¨ç”Ÿæˆ` |
| âš™ï¸ **é…ç½®ç®¡ç†** | `æ‰¹é‡ä¿®æ”¹é…ç½®æ–‡ä»¶` | `æ¡ä»¶å¤„ç†å’Œæ–‡æœ¬æ›¿æ¢` |
| ğŸš¨ **æ•…éšœè¯Šæ–­** | `åˆ†æç³»ç»ŸçŠ¶æ€å’Œé”™è¯¯` | `å¤æ‚é€»è¾‘åˆ¤æ–­å’Œæ•°æ®å…³è”` |

---

## 2. ğŸ“Š ç³»ç»Ÿç›‘æ§ä¸æ€§èƒ½åˆ†æ


### 2.1 ç³»ç»Ÿèµ„æºç›‘æ§è„šæœ¬


**ç›‘æ§CPUä½¿ç”¨ç‡ï¼š**
```bash
# å®æ—¶ç›‘æ§CPUä½¿ç”¨ç‡
top -b -n1 | awk '
/^%Cpu/ {
    # æå–CPUç©ºé—²ç‡
    idle = $8
    used = 100 - idle
    printf "CPUä½¿ç”¨ç‡: %.1f%%\n", used
    
    # å‘Šè­¦åˆ¤æ–­
    if (used > 80) {
        print "âš ï¸ CPUä½¿ç”¨ç‡è¿‡é«˜ï¼å½“å‰: " used "%"
    }
}'
```

> **ğŸ”§ å®è·µæŠ€å·§**
> ä½¿ç”¨`top -b -n1`è·å–ä¸€æ¬¡æ€§è¾“å‡ºï¼Œé¿å…äº¤äº’æ¨¡å¼å½±å“è„šæœ¬æ‰§è¡Œ

**å†…å­˜ä½¿ç”¨ç›‘æ§ï¼š**
```bash
# åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ
free -m | awk '
/^Mem:/ {
    total = $2
    used = $3
    available = $7
    usage_rate = (used/total)*100
    
    printf "å†…å­˜æ€»é‡: %dMB\n", total
    printf "å·²ä½¿ç”¨: %dMB (%.1f%%)\n", used, usage_rate
    printf "å¯ç”¨: %dMB\n", available
    
    # å†…å­˜å‘Šè­¦
    if (usage_rate > 90) {
        print "ğŸ”´ å†…å­˜ä½¿ç”¨ç‡å±é™©: " usage_rate "%"
    } else if (usage_rate > 75) {
        print "ğŸŸ¡ å†…å­˜ä½¿ç”¨ç‡è¾ƒé«˜: " usage_rate "%"
    }
}'
```

### 2.2 ç£ç›˜ç©ºé—´ç›‘æ§


**æ™ºèƒ½ç£ç›˜ç›‘æ§è„šæœ¬ï¼š**
```bash
# ç£ç›˜ä½¿ç”¨ç‡ç›‘æ§å’Œæ¸…ç†å»ºè®®
df -h | awk '
BEGIN {
    print "=== ç£ç›˜ä½¿ç”¨æƒ…å†µç›‘æ§ ==="
    print "æŒ‚è½½ç‚¹\t\tä½¿ç”¨ç‡\tå‰©ä½™ç©ºé—´\tçŠ¶æ€"
}

# è·³è¿‡æ ‡é¢˜è¡Œ
NR > 1 && $5 != "0%" {
    mount_point = $6
    usage_rate = $5
    available = $4
    
    # æå–æ•°å­—ï¼ˆå»æ‰%å·ï¼‰
    gsub(/%/, "", usage_rate)
    usage_num = usage_rate + 0
    
    # çŠ¶æ€åˆ¤æ–­
    if (usage_num >= 95) {
        status = "ğŸ”´ ç´§æ€¥"
    } else if (usage_num >= 85) {
        status = "ğŸŸ¡ è­¦å‘Š" 
    } else {
        status = "ğŸŸ¢ æ­£å¸¸"
    }
    
    printf "%-15s\t%s%%\t\t%s\t\t%s\n", mount_point, usage_rate, available, status
    
    # æ¸…ç†å»ºè®®
    if (usage_num >= 90) {
        print "ğŸ’¡ å»ºè®®æ¸…ç† " mount_point " ç›®å½•ä¸‹çš„ä¸´æ—¶æ–‡ä»¶"
    }
}'
```

### 2.3 è¿›ç¨‹ç›‘æ§ä¸åˆ†æ


**æ‰¾å‡ºæ¶ˆè€—èµ„æºæœ€å¤šçš„è¿›ç¨‹ï¼š**
```bash
# åˆ†æè¿›ç¨‹èµ„æºä½¿ç”¨æƒ…å†µ
ps aux | awk '
BEGIN {
    print "=== TOPè¿›ç¨‹èµ„æºä½¿ç”¨åˆ†æ ==="
    max_cpu = 0
    max_mem = 0
}

# è·³è¿‡æ ‡é¢˜è¡Œï¼Œå¤„ç†è¿›ç¨‹ä¿¡æ¯
NR > 1 {
    user = $1
    cpu = $3 + 0    # è½¬ä¸ºæ•°å­—
    mem = $4 + 0
    command = $11
    
    # è®°å½•æœ€é«˜CPUä½¿ç”¨ç‡
    if (cpu > max_cpu) {
        max_cpu = cpu
        max_cpu_process = user ":" command
    }
    
    # è®°å½•æœ€é«˜å†…å­˜ä½¿ç”¨ç‡
    if (mem > max_mem) {
        max_mem = mem
        max_mem_process = user ":" command
    }
    
    # æ”¶é›†é«˜æ¶ˆè€—è¿›ç¨‹
    if (cpu > 5.0 || mem > 10.0) {
        high_usage[NR] = sprintf("%s\t%.1f%%\t%.1f%%\t%s", user, cpu, mem, command)
    }
}

END {
    print "\nğŸ† èµ„æºæ¶ˆè€—å† å†›ï¼š"
    printf "CPUæœ€é«˜: %.1f%% - %s\n", max_cpu, max_cpu_process
    printf "å†…å­˜æœ€é«˜: %.1f%% - %s\n", max_mem, max_mem_process
    
    if (length(high_usage) > 0) {
        print "\nâš ï¸ é«˜èµ„æºæ¶ˆè€—è¿›ç¨‹ï¼š"
        print "ç”¨æˆ·\t\tCPU%\tå†…å­˜%\tå‘½ä»¤"
        for (i in high_usage) {
            print high_usage[i]
        }
    }
}'
```

---

## 3. âš™ï¸ é…ç½®æ–‡ä»¶ç®¡ç†ä¸å¤„ç†


### 3.1 é…ç½®æ–‡ä»¶è§£æä¸éªŒè¯


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> é…ç½®æ–‡ä»¶é€šå¸¸æ˜¯`key=value`æˆ–`key: value`æ ¼å¼ï¼Œawkæ“…é•¿è§£æè¿™ç§ç»“æ„åŒ–æ–‡æœ¬

**Apacheé…ç½®æ–‡ä»¶æ£€æŸ¥ï¼š**
```bash
# æ£€æŸ¥Apacheè™šæ‹Ÿä¸»æœºé…ç½®
awk '
BEGIN {
    in_vhost = 0
    vhost_count = 0
}

# æ£€æµ‹è™šæ‹Ÿä¸»æœºå¼€å§‹
/<VirtualHost/ {
    in_vhost = 1
    vhost_count++
    current_vhost = $0
    print "\n=== è™šæ‹Ÿä¸»æœº #" vhost_count " ==="
    print "é…ç½®: " $0
}

# åœ¨è™šæ‹Ÿä¸»æœºå†…éƒ¨
in_vhost == 1 {
    if (/ServerName/) {
        server_name = $2
        print "åŸŸå: " server_name
    }
    if (/DocumentRoot/) {
        doc_root = $2
        print "æ ¹ç›®å½•: " doc_root
        
        # æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼ˆæ¨¡æ‹Ÿï¼‰
        if (doc_root !~ /^\//) {
            print "âš ï¸ è­¦å‘Š: æ ¹ç›®å½•è·¯å¾„ä¸æ˜¯ç»å¯¹è·¯å¾„"
        }
    }
    if (/Listen/) {
        port = $2
        print "ç›‘å¬ç«¯å£: " port
    }
}

# è™šæ‹Ÿä¸»æœºç»“æŸ
/<\/VirtualHost>/ {
    in_vhost = 0
    print "âœ… è™šæ‹Ÿä¸»æœºé…ç½®å®Œæ•´"
}

END {
    print "\nğŸ“Š ç»Ÿè®¡ä¿¡æ¯:"
    print "æ€»è™šæ‹Ÿä¸»æœºæ•°é‡: " vhost_count
}
' /etc/apache2/sites-available/default
```

### 3.2 æ‰¹é‡é…ç½®æ–‡ä»¶ä¿®æ”¹


**ä¿®æ”¹å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ï¼š**
```bash
# æ‰¹é‡æ›´æ–°æ•°æ®åº“è¿æ¥é…ç½®
update_db_config() {
    find /etc/myapp/ -name "*.conf" | while read config_file; do
        echo "å¤„ç†é…ç½®æ–‡ä»¶: $config_file"
        
        awk -v new_host="$DB_HOST" -v new_port="$DB_PORT" '
        {
            # æ›´æ–°æ•°æ®åº“ä¸»æœº
            if (/^db_host/) {
                print "db_host=" new_host
                modified = 1
            }
            # æ›´æ–°ç«¯å£
            else if (/^db_port/) {
                print "db_port=" new_port  
                modified = 1
            }
            # ä¿æŒå…¶ä»–é…ç½®ä¸å˜
            else {
                print $0
            }
        }
        
        END {
            if (modified) {
                print "# é…ç½®å·²äº " strftime("%Y-%m-%d %H:%M:%S") " æ›´æ–°" > "/dev/stderr"
            }
        }
        ' "$config_file" > "$config_file.tmp" && mv "$config_file.tmp" "$config_file"
    done
}
```

---

## 4. ğŸ”„ æ‰¹é‡æ“ä½œè‡ªåŠ¨åŒ–


### 4.1 ç”¨æˆ·è´¦æˆ·ç®¡ç†


**æ‰¹é‡åˆ›å»ºç”¨æˆ·è„šæœ¬ï¼š**
```bash
# ä»CSVæ–‡ä»¶æ‰¹é‡åˆ›å»ºç”¨æˆ·
# æ ¼å¼: username,fullname,department,email
awk -F',' '
# è·³è¿‡CSVæ ‡é¢˜è¡Œ
NR > 1 && NF >= 4 {
    username = $1
    fullname = $2
    department = $3  
    email = $4
    
    # éªŒè¯ç”¨æˆ·åæ ¼å¼
    if (username !~ /^[a-z][a-z0-9_-]*$/) {
        print "âŒ ç”¨æˆ·åæ ¼å¼é”™è¯¯: " username > "/dev/stderr"
        next
    }
    
    # ç”Ÿæˆåˆ›å»ºç”¨æˆ·çš„å‘½ä»¤
    printf "# åˆ›å»ºç”¨æˆ·: %s (%s)\n", username, fullname
    printf "useradd -c \"%s\" -d /home/%s -m -s /bin/bash %s\n", fullname, username, username
    
    # è®¾ç½®åˆå§‹å¯†ç 
    printf "echo \"%s:temp123\" | chpasswd\n", username
    
    # æ·»åŠ åˆ°å¯¹åº”éƒ¨é—¨ç»„
    printf "usermod -a -G %s %s\n", tolower(department), username
    
    print "echo \"ç”¨æˆ· " username " åˆ›å»ºå®Œæˆ\""
    print ""
}
' users.csv > create_users.sh
```

### 4.2 æ–‡ä»¶æƒé™æ‰¹é‡ç®¡ç†


**ç›®å½•æƒé™å®¡è®¡å’Œä¿®å¤ï¼š**
```bash
# æ£€æŸ¥å’Œä¿®å¤Webç›®å½•æƒé™
find /var/www -type f -o -type d | while read item; do
    ls -ld "$item"
done | awk '
{
    perms = $1
    owner = $3
    group = $4
    path = $9
    
    # åˆ¤æ–­æ–‡ä»¶ç±»å‹
    if (substr(perms, 1, 1) == "d") {
        type = "ç›®å½•"
        expected_perm = "755"
    } else {
        type = "æ–‡ä»¶"
        expected_perm = "644"
    }
    
    # æå–æ•°å­—æƒé™
    current_perm = substr(perms, 2)
    
    # è½¬æ¢æƒé™è¡¨ç¤º
    perm_num = ""
    for (i = 1; i <= 9; i += 3) {
        section = substr(current_perm, i, 3)
        value = 0
        if (substr(section, 1, 1) == "r") value += 4
        if (substr(section, 2, 1) == "w") value += 2  
        if (substr(section, 3, 1) == "x") value += 1
        perm_num = perm_num value
    }
    
    # æ£€æŸ¥æƒé™æ˜¯å¦æ­£ç¡®
    if (perm_num != expected_perm) {
        printf "ğŸ”§ éœ€è¦ä¿®å¤: %s\n", path
        printf "   å½“å‰æƒé™: %s (%s)\n", perm_num, perms
        printf "   å»ºè®®æƒé™: %s\n", expected_perm
        printf "   ä¿®å¤å‘½ä»¤: chmod %s \"%s\"\n\n", expected_perm, path
    }
    
    # æ£€æŸ¥æ‰€æœ‰è€…
    if (owner != "www-data") {
        printf "ğŸ‘¤ æ‰€æœ‰è€…å¼‚å¸¸: %s (å½“å‰: %s, å»ºè®®: www-data)\n", path, owner
        printf "   ä¿®å¤å‘½ä»¤: chown www-data:www-data \"%s\"\n\n", path
    }
}'
```

---

## 5. ğŸ“ˆ è¿ç»´æŠ¥å‘Šç”Ÿæˆ


### 5.1 ç³»ç»Ÿå¥åº·çŠ¶æ€æŠ¥å‘Š


**ç”Ÿæˆæ¯æ—¥ç³»ç»ŸæŠ¥å‘Šï¼š**
```bash
#!/bin/bash
# ç³»ç»Ÿæ—¥æŠ¥ç”Ÿæˆè„šæœ¬

generate_system_report() {
    echo "=== $(date '+%Yå¹´%mæœˆ%dæ—¥') ç³»ç»Ÿè¿è¡ŒæŠ¥å‘Š ==="
    
    # CPUå’Œè´Ÿè½½ä¿¡æ¯
    uptime | awk '{
        print "\nğŸ–¥ï¸ ç³»ç»Ÿè´Ÿè½½ä¿¡æ¯:"
        print "è¿è¡Œæ—¶é—´: " $3 " " $4
        print "å¹³å‡è´Ÿè½½: " $(NF-2) " " $(NF-1) " " $NF
    }'
    
    # å†…å­˜ä½¿ç”¨ç»Ÿè®¡
    free -m | awk '
    BEGIN { print "\nğŸ’¾ å†…å­˜ä½¿ç”¨ç»Ÿè®¡:" }
    /^Mem:/ {
        total = $2
        used = $3  
        available = $7
        printf "æ€»å†…å­˜: %dMB | å·²ä½¿ç”¨: %dMB (%.1f%%) | å¯ç”¨: %dMB\n", 
               total, used, (used/total)*100, available
    }'
    
    # ç£ç›˜ä½¿ç”¨æ¦‚è§ˆ
    df -h | awk '
    BEGIN { 
        print "\nğŸ’¿ ç£ç›˜ä½¿ç”¨æ¦‚è§ˆ:"
        print "æŒ‚è½½ç‚¹\t\tæ€»ç©ºé—´\tå·²ä½¿ç”¨\tä½¿ç”¨ç‡"
    }
    NR > 1 && $6 ~ /^\// {
        printf "%-15s\t%s\t%s\t%s\n", $6, $2, $3, $5
    }'
    
    # ç½‘ç»œè¿æ¥ç»Ÿè®¡
    netstat -an | awk '
    BEGIN {
        print "\nğŸŒ ç½‘ç»œè¿æ¥ç»Ÿè®¡:"
        tcp_conn = 0
        listening = 0
    }
    /^tcp/ {
        tcp_conn++
        if ($6 == "LISTEN") listening++
    }
    END {
        printf "TCPè¿æ¥æ€»æ•°: %d | ç›‘å¬ç«¯å£: %d\n", tcp_conn, listening
    }'
}

generate_system_report > "/var/log/system-report-$(date +%Y%m%d).txt"
```

### 5.2 åº”ç”¨æœåŠ¡çŠ¶æ€æŠ¥å‘Š


**WebæœåŠ¡è®¿é—®ç»Ÿè®¡ï¼š**
```bash
# åˆ†æApacheè®¿é—®æ—¥å¿—
analyze_access_log() {
    awk '
    BEGIN {
        print "=== Webè®¿é—®æ—¥å¿—åˆ†ææŠ¥å‘Š ==="
        total_requests = 0
        error_requests = 0
    }
    
    {
        total_requests++
        
        # æå–IPã€çŠ¶æ€ç ã€è¯·æ±‚å¤§å°
        ip = $1
        status_code = $9
        size = ($10 == "-") ? 0 : $10
        request = $7
        
        # ç»Ÿè®¡IPè®¿é—®
        ip_count[ip]++
        
        # ç»Ÿè®¡çŠ¶æ€ç 
        status_count[status_code]++
        
        # ç»Ÿè®¡é”™è¯¯è¯·æ±‚
        if (status_code >= 400) {
            error_requests++
            error_details[ip "/" request] = status_code
        }
        
        # ç´¯è®¡ä¼ è¾“å­—èŠ‚
        total_bytes += size
    }
    
    END {
        printf "\nğŸ“Š æ€»ä½“ç»Ÿè®¡:\n"
        printf "æ€»è¯·æ±‚æ•°: %d\n", total_requests
        printf "é”™è¯¯è¯·æ±‚: %d (%.2f%%)\n", error_requests, (error_requests/total_requests)*100
        printf "æ€»ä¼ è¾“: %.2fMB\n", total_bytes/1024/1024
        
        print "\nğŸ† TOPè®¿é—®IP:"
        # å¯¹IPæŒ‰è®¿é—®æ¬¡æ•°æ’åº
        n = asorti(ip_count, sorted_ips, "@val_num_desc")
        for (i = 1; i <= (n > 10 ? 10 : n); i++) {
            printf "%s: %dæ¬¡\n", sorted_ips[i], ip_count[sorted_ips[i]]
        }
        
        print "\nğŸ“ˆ HTTPçŠ¶æ€ç åˆ†å¸ƒ:"
        for (code in status_count) {
            printf "%s: %dæ¬¡\n", code, status_count[code]
        }
        
        if (error_requests > 0) {
            print "\nâŒ é”™è¯¯è¯·æ±‚è¯¦æƒ…:"
            for (detail in error_details) {
                printf "%s -> %s\n", detail, error_details[detail]
            }
        }
    }
    ' /var/log/apache2/access.log
}
```

---

## 6. ğŸš¨ æ•…éšœè¯Šæ–­è„šæœ¬å¼€å‘


### 6.1 æ—¥å¿—é”™è¯¯åˆ†æ


> **âš ï¸ æ³¨æ„äº‹é¡¹**
> æ•…éšœè¯Šæ–­æ—¶è¦å…³æ³¨é”™è¯¯çš„æ—¶é—´åˆ†å¸ƒå’Œå…³è”æ€§ï¼Œä¸ä»…ä»…æ˜¯æ•°é‡ç»Ÿè®¡

**æ™ºèƒ½æ—¥å¿—åˆ†æè„šæœ¬ï¼š**
```bash
# åˆ†æç³»ç»Ÿæ—¥å¿—ä¸­çš„é”™è¯¯æ¨¡å¼
analyze_system_errors() {
    tail -n 1000 /var/log/syslog | awk '
    BEGIN {
        print "=== ç³»ç»Ÿé”™è¯¯è¯Šæ–­åˆ†æ ==="
        current_hour = strftime("%H")
    }
    
    # åŒ¹é…é”™è¯¯ã€è­¦å‘Šã€å¤±è´¥ç­‰å…³é”®è¯
    /ERROR|error|WARN|warning|FAIL|failed|denied/ {
        # æå–æ—¶é—´å’ŒæœåŠ¡å
        datetime = $1 " " $2 " " $3
        service = $5
        message = substr($0, index($0, $6))
        
        # æŒ‰å°æ—¶ç»Ÿè®¡é”™è¯¯
        hour = substr($3, 1, 2)  
        error_by_hour[hour]++
        
        # æŒ‰æœåŠ¡ç»Ÿè®¡é”™è¯¯  
        gsub(/:/, "", service)
        service_errors[service]++
        
        # æ”¶é›†ä¸¥é‡é”™è¯¯
        if (/CRITICAL|critical|FATAL|fatal/) {
            critical_errors[NR] = datetime ": " message
        }
        
        # æ”¶é›†è®¤è¯å¤±è´¥
        if (/authentication failed|login failed|access denied/) {
            auth_failures[NR] = datetime ": " service " - " message
        }
        
        total_errors++
    }
    
    END {
        printf "\nğŸ“Š é”™è¯¯ç»Ÿè®¡æ¦‚è§ˆ:\n"
        printf "æ€»é”™è¯¯æ•°é‡: %d\n", total_errors
        
        if (total_errors == 0) {
            print "ğŸŸ¢ ç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼Œæœªå‘ç°ä¸¥é‡é”™è¯¯"
            exit
        }
        
        print "\nâ° é”™è¯¯æ—¶é—´åˆ†å¸ƒ:"
        for (hour in error_by_hour) {
            stars = ""
            count = error_by_hour[hour]
            for (i = 1; i <= int(count/5) + 1; i++) {
                stars = stars "*"
            }
            printf "%s:00 - %dæ¬¡ %s\n", hour, count, stars
        }
        
        print "\nğŸ”§ é—®é¢˜æœåŠ¡æ’è¡Œ:"
        n = asorti(service_errors, sorted_services, "@val_num_desc")
        for (i = 1; i <= (n > 5 ? 5 : n); i++) {
            service = sorted_services[i]
            count = service_errors[service]
            printf "%s: %dæ¬¡é”™è¯¯\n", service, count
        }
        
        # æ˜¾ç¤ºä¸¥é‡é”™è¯¯
        if (length(critical_errors) > 0) {
            print "\nğŸš¨ ä¸¥é‡é”™è¯¯è­¦å‘Š:"
            for (i in critical_errors) {
                print critical_errors[i]
            }
        }
        
        # æ˜¾ç¤ºå®‰å…¨é—®é¢˜
        if (length(auth_failures) > 0) {
            print "\nğŸ”’ è®¤è¯å¤±è´¥è®°å½•:"
            for (i in auth_failures) {
                print auth_failures[i]
            }
        }
        
        # ç»™å‡ºå»ºè®®
        print "\nğŸ’¡ è¯Šæ–­å»ºè®®:"
        if (service_errors["sshd"] > 10) {
            print "- SSHæœåŠ¡å¼‚å¸¸é¢‘ç¹ï¼Œå»ºè®®æ£€æŸ¥ç½‘ç»œå®‰å…¨"
        }
        if (total_errors > 50) {
            print "- é”™è¯¯æ•°é‡è¾ƒå¤šï¼Œå»ºè®®è¿›è¡Œç³»ç»Ÿç»´æŠ¤"
        }
    }'
}
```

### 6.2 æœåŠ¡å¯ç”¨æ€§æ£€æµ‹


**æœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬ï¼š**
```bash
# æ£€æŸ¥å…³é”®æœåŠ¡çŠ¶æ€
check_services_health() {
    # å®šä¹‰å…³é”®æœåŠ¡åˆ—è¡¨
    critical_services="nginx mysql redis php-fpm"
    
    echo "$critical_services" | awk '
    BEGIN {
        print "=== æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥ ==="
        all_healthy = 1
    }
    
    {
        # éå†æ¯ä¸ªæœåŠ¡
        for (i = 1; i <= NF; i++) {
            service = $i
            
            # æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼ˆæ¨¡æ‹Ÿï¼‰
            cmd = "systemctl is-active " service " 2>/dev/null"
            cmd | getline status
            close(cmd)
            
            # æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯ç”¨
            cmd2 = "systemctl is-enabled " service " 2>/dev/null"  
            cmd2 | getline enabled
            close(cmd2)
            
            # çŠ¶æ€åˆ¤æ–­
            if (status == "active") {
                status_icon = "ğŸŸ¢"
                status_text = "æ­£å¸¸è¿è¡Œ"
            } else {
                status_icon = "ğŸ”´"
                status_text = "æœåŠ¡å¼‚å¸¸"
                all_healthy = 0
                failed_services[service] = status
            }
            
            # å¯ç”¨çŠ¶æ€
            enabled_text = (enabled == "enabled") ? "å·²å¯ç”¨" : "æœªå¯ç”¨"
            
            printf "%-10s %s %s (%s)\n", service, status_icon, status_text, enabled_text
        }
    }
    
    END {
        print "\nğŸ“‹ å¥åº·æ£€æŸ¥æ€»ç»“:"
        if (all_healthy) {
            print "âœ… æ‰€æœ‰å…³é”®æœåŠ¡è¿è¡Œæ­£å¸¸"
        } else {
            print "âŒ å‘ç°æœåŠ¡å¼‚å¸¸ï¼Œéœ€è¦å¤„ç†:"
            for (service in failed_services) {
                printf "   %s: %s\n", service, failed_services[service]
                printf "   ä¿®å¤å»ºè®®: systemctl restart %s\n", service
            }
        }
    }'
}
```

---

## 7. ğŸ”„ è‡ªåŠ¨åŒ–è¿ç»´é›†æˆ


### 7.1 å®šæ—¶ä»»åŠ¡ç®¡ç†


**Crontabä»»åŠ¡ç›‘æ§ï¼š**
```bash
# æ£€æŸ¥å’Œç®¡ç†å®šæ—¶ä»»åŠ¡
manage_cron_jobs() {
    crontab -l 2>/dev/null | awk '
    BEGIN {
        print "=== å®šæ—¶ä»»åŠ¡åˆ†ææŠ¥å‘Š ==="
        job_count = 0
    }
    
    # è·³è¿‡æ³¨é‡Šè¡Œ
    !/^#/ && NF > 0 {
        job_count++
        
        # è§£æcronè¡¨è¾¾å¼
        minute = $1
        hour = $2  
        day = $3
        month = $4
        weekday = $5
        command = substr($0, index($0, $6))
        
        # åˆ†ææ‰§è¡Œé¢‘ç‡
        if (minute == "*" && hour == "*") {
            frequency = "æ¯åˆ†é’Ÿ"
        } else if (hour == "*") {
            frequency = "æ¯å°æ—¶"
        } else if (day == "*") {
            frequency = "æ¯å¤©"  
        } else {
            frequency = "å®šæœŸ"
        }
        
        printf "\nä»»åŠ¡ #%d:\n", job_count
        printf "  æ—¶é—´: %s %s %s %s %s\n", minute, hour, day, month, weekday
        printf "  é¢‘ç‡: %s\n", frequency
        printf "  å‘½ä»¤: %s\n", command
        
        # å®‰å…¨æ£€æŸ¥
        if (command ~ /rm -rf|dd if=|mkfs/) {
            print "  âš ï¸ è­¦å‘Š: åŒ…å«å±é™©æ“ä½œ"
        }
        
        # è·¯å¾„æ£€æŸ¥
        if (command !~ /^\//) {
            print "  ğŸ’¡ å»ºè®®: ä½¿ç”¨ç»å¯¹è·¯å¾„"
        }
    }
    
    END {
        printf "\nğŸ“Š ç»Ÿè®¡ä¿¡æ¯:\n"
        printf "æ€»ä»»åŠ¡æ•°: %d\n", job_count
        
        if (job_count == 0) {
            print "ğŸ’¡ æç¤º: æ²¡æœ‰é…ç½®å®šæ—¶ä»»åŠ¡"
        } else if (job_count > 20) {
            print "âš ï¸ æ³¨æ„: å®šæ—¶ä»»åŠ¡è¾ƒå¤šï¼Œå»ºè®®å®šæœŸæ¸…ç†"
        }
    }'
}
```

### 7.2 è‡ªåŠ¨åŒ–éƒ¨ç½²æ”¯æŒ


**éƒ¨ç½²çŠ¶æ€éªŒè¯ï¼š**
```bash
# éªŒè¯åº”ç”¨éƒ¨ç½²çŠ¶æ€
validate_deployment() {
    app_name=$1
    
    echo "éªŒè¯åº”ç”¨: $app_name" | awk -v app="$app_name" '
    BEGIN {
        print "=== éƒ¨ç½²çŠ¶æ€éªŒè¯: " app " ==="
        
        # æ£€æŸ¥è¿›ç¨‹
        cmd = "pgrep -f " app
        if ((cmd | getline pid) > 0) {
            print "âœ… è¿›ç¨‹è¿è¡Œä¸­: PID " pid
            process_ok = 1
        } else {
            print "âŒ è¿›ç¨‹æœªè¿è¡Œ"
            process_ok = 0
        }
        close(cmd)
        
        # æ£€æŸ¥ç«¯å£
        port_cmd = "netstat -tlnp | grep " app
        if ((port_cmd | getline port_info) > 0) {
            print "âœ… ç«¯å£ç›‘å¬: " port_info
            port_ok = 1
        } else {
            print "âŒ ç«¯å£æœªç›‘å¬"
            port_ok = 0
        }
        close(port_cmd)
        
        # æ£€æŸ¥é…ç½®æ–‡ä»¶
        config_file = "/etc/" app "/" app ".conf"
        if ((getline < config_file) >= 0) {
            print "âœ… é…ç½®æ–‡ä»¶å­˜åœ¨: " config_file
            config_ok = 1
        } else {
            print "âŒ é…ç½®æ–‡ä»¶ç¼ºå¤±: " config_file
            config_ok = 0
        }
        close(config_file)
        
        # æ€»ä½“è¯„ä¼°
        total_checks = 3
        passed_checks = process_ok + port_ok + config_ok
        
        printf "\nğŸ“Š éƒ¨ç½²å¥åº·åº¦: %d/%d (%.0f%%)\n", 
               passed_checks, total_checks, (passed_checks/total_checks)*100
        
        if (passed_checks == total_checks) {
            print "ğŸ‰ éƒ¨ç½²å®Œå…¨æˆåŠŸï¼"
        } else {
            print "âš ï¸ éƒ¨ç½²å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦ä¿®å¤"
        }
    }'
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæŠ€èƒ½


```
ğŸ”¸ ç³»ç»Ÿç›‘æ§ï¼šä½¿ç”¨awkåˆ†ætopã€freeã€dfç­‰ç³»ç»Ÿå‘½ä»¤è¾“å‡º
ğŸ”¸ æ—¥å¿—åˆ†æï¼šè§£æå„ç§æ ¼å¼çš„æ—¥å¿—æ–‡ä»¶ï¼Œæå–å…³é”®ä¿¡æ¯
ğŸ”¸ é…ç½®ç®¡ç†ï¼šæ‰¹é‡å¤„ç†å’ŒéªŒè¯é…ç½®æ–‡ä»¶
ğŸ”¸ è‡ªåŠ¨åŒ–è„šæœ¬ï¼šç¼–å†™å¯é‡å¤æ‰§è¡Œçš„è¿ç»´è„šæœ¬
ğŸ”¸ æ•…éšœè¯Šæ–­ï¼šé€šè¿‡æ•°æ®åˆ†æå¿«é€Ÿå®šä½é—®é¢˜
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ awkåœ¨è¿ç»´ä¸­çš„ä»·å€¼**
```
æ•°æ®å¤„ç†èƒ½åŠ›ï¼š
- æ“…é•¿å¤„ç†ç»“æ„åŒ–æ–‡æœ¬æ•°æ®
- å¼ºå¤§çš„æ•°å€¼è®¡ç®—å’Œç»Ÿè®¡åŠŸèƒ½
- çµæ´»çš„æ¨¡å¼åŒ¹é…å’Œæ¡ä»¶å¤„ç†

è‡ªåŠ¨åŒ–ä¼˜åŠ¿ï¼š
- ä¸€è¡Œå‘½ä»¤è§£å†³å¤æ‚é—®é¢˜
- å¯ä»¥åµŒå…¥shellè„šæœ¬ä¸­
- ä¸ç³»ç»Ÿå‘½ä»¤å®Œç¾é…åˆ
```

**ğŸ”¹ è¿ç»´è„šæœ¬è®¾è®¡åŸåˆ™**
```
å¥å£®æ€§ï¼š
- é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µè€ƒè™‘
- è¾“å…¥éªŒè¯å’Œå‚æ•°æ£€æŸ¥
- æ—¥å¿—è®°å½•å’ŒçŠ¶æ€åé¦ˆ

å¯ç»´æŠ¤æ€§ï¼š
- æ¸…æ™°çš„å˜é‡å‘½å
- é€‚å½“çš„æ³¨é‡Šè¯´æ˜
- æ¨¡å—åŒ–çš„å‡½æ•°è®¾è®¡
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ“ˆ æ•ˆç‡æå‡ï¼š**
- è‡ªåŠ¨åŒ–æ—¥å¸¸è¿ç»´ä»»åŠ¡
- å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜
- ç”Ÿæˆè¯¦ç»†çš„ç›‘æ§æŠ¥å‘Š

**ğŸ›¡ï¸ ç³»ç»Ÿç¨³å®šæ€§ï¼š**
- é¢„é˜²æ€§ç›‘æ§å’Œå‘Šè­¦
- åŠæ—¶å‘ç°æ½œåœ¨é—®é¢˜
- æ ‡å‡†åŒ–çš„å¤„ç†æµç¨‹

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®ï¼š**

| åœºæ™¯ | **å»ºè®®åšæ³•** | **é¿å…** |
|------|------------|----------|
| ğŸ” **ç›‘æ§è„šæœ¬** | `è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼` | `è¿‡äºé¢‘ç¹çš„æ£€æŸ¥` |
| ğŸ“ **æ—¥å¿—åˆ†æ** | `å…³æ³¨è¶‹åŠ¿å’Œæ¨¡å¼` | `åªçœ‹ç»å¯¹æ•°é‡` |
| âš™ï¸ **é…ç½®ç®¡ç†** | `å¤‡ä»½åŸå§‹é…ç½®` | `ç›´æ¥ä¿®æ”¹ç”Ÿäº§é…ç½®` |
| ğŸš€ **è‡ªåŠ¨åŒ–éƒ¨ç½²** | `åˆ†æ­¥éªŒè¯ç»“æœ` | `ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰æ“ä½œ` |

**æ ¸å¿ƒè®°å¿†ï¼š**
- awkæ˜¯è¿ç»´äººå‘˜çš„å¾—åŠ›åŠ©æ‰‹ï¼Œä¸“æ²»å„ç§æ–‡æœ¬æ•°æ®
- ç³»ç»Ÿç›‘æ§é‡åœ¨è¶‹åŠ¿åˆ†æï¼Œä¸æ˜¯ç®€å•çš„æ•°å€¼æ¯”è¾ƒ
- æ•…éšœè¯Šæ–­è¦å…³è”åˆ†æï¼Œæ‰¾å‡ºé—®é¢˜çš„æ ¹æœ¬åŸå› 
- è‡ªåŠ¨åŒ–è„šæœ¬è¦è€ƒè™‘å¼‚å¸¸æƒ…å†µï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§