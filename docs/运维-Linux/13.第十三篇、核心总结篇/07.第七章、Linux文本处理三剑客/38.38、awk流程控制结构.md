---
title: 38ã€awkæµç¨‹æ§åˆ¶ç»“æ„
---
## ğŸ“š ç›®å½•


1. [awkæµç¨‹æ§åˆ¶æ¦‚è¿°](#1-awkæµç¨‹æ§åˆ¶æ¦‚è¿°)
2. [æ¡ä»¶è¯­å¥(if-else)](#2-æ¡ä»¶è¯­å¥if-else)
3. [å¾ªç¯è¯­å¥(for while)](#3-å¾ªç¯è¯­å¥for-while)
4. [è·³è½¬è¯­å¥(break continue)](#4-è·³è½¬è¯­å¥break-continue)
5. [å‡½æ•°è°ƒç”¨æ§åˆ¶](#5-å‡½æ•°è°ƒç”¨æ§åˆ¶)
6. [å¼‚å¸¸å¤„ç†æœºåˆ¶](#6-å¼‚å¸¸å¤„ç†æœºåˆ¶)
7. [ç¨‹åºé€€å‡ºæ§åˆ¶(exit)](#7-ç¨‹åºé€€å‡ºæ§åˆ¶exit)
8. [åµŒå¥—ç»“æ„ä½¿ç”¨](#8-åµŒå¥—ç»“æ„ä½¿ç”¨)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ è·¯å¾„å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦æŒæ¡awkåŸºæœ¬è¯­æ³•ã€å˜é‡ä½¿ç”¨ â†’ **å½“å‰å†…å®¹**ï¼šawkæµç¨‹æ§åˆ¶ç»“æ„ â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ awkå‡½æ•°å®šä¹‰å’Œæ•°ç»„æ“ä½œ

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡45åˆ†é’Ÿ | å®è·µç»ƒä¹ 30åˆ†é’Ÿ

ğŸ·ï¸ **é‡è¦ç¨‹åº¦æ ‡è¯†**ï¼š`#æ ¸å¿ƒå¿…ä¼š` `#ç¼–ç¨‹åŸºç¡€` `#å®ç”¨æŠ€èƒ½`

---

## 1. ğŸŒ awkæµç¨‹æ§åˆ¶æ¦‚è¿°



### 1.1 ä»€ä¹ˆæ˜¯æµç¨‹æ§åˆ¶



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
æµç¨‹æ§åˆ¶æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­æ§åˆ¶ç¨‹åºæ‰§è¡Œé¡ºåºå’Œé€»è¾‘åˆ†æ”¯çš„æœºåˆ¶ï¼Œè®©ç¨‹åºèƒ½å¤Ÿæ ¹æ®ä¸åŒæ¡ä»¶åšå‡ºä¸åŒçš„å¤„ç†å†³ç­–ã€‚

**ğŸ’¡ é€šä¿—ç†è§£**
```
å°±åƒç”Ÿæ´»ä¸­çš„å†³ç­–è¿‡ç¨‹ï¼š

æ—¥å¸¸ä¾‹å­ï¼š
å¦‚æœä»Šå¤©ä¸‹é›¨ â†’ å¸¦é›¨ä¼
å¦åˆ™ â†’ ä¸å¸¦é›¨ä¼

while è¿˜æ²¡åˆ°å…¬å¸ â†’ ç»§ç»­èµ°è·¯
for æ¯ä¸ªçº¢ç»¿ç¯ â†’ è§‚å¯Ÿä¿¡å·

awkç¨‹åºä¹Ÿæ˜¯è¿™æ ·åšå†³ç­–å’Œé‡å¤æ‰§è¡Œä»»åŠ¡
```

### 1.2 awkæµç¨‹æ§åˆ¶çš„ç‰¹ç‚¹



**ğŸ”¹ awkä¸å…¶ä»–è¯­è¨€çš„åŒºåˆ«**

| **ç‰¹ç‚¹** | **awk** | **ä¼ ç»Ÿç¼–ç¨‹è¯­è¨€** |
|---------|---------|------------------|
| **æ‰§è¡Œæ¨¡å¼** | é€è¡Œè‡ªåŠ¨å¤„ç† | éœ€è¦æ˜ç¡®å¾ªç¯è¯»å– |
| **ä¸»å¾ªç¯** | å†…ç½®è‡ªåŠ¨å¾ªç¯ | æ‰‹åŠ¨æ§åˆ¶å¾ªç¯ |
| **æ•°æ®å¤„ç†** | é¢å‘æ–‡æœ¬è¡Œ | é€šç”¨æ•°æ®ç±»å‹ |

**ğŸ”¸ awkæµç¨‹æ§åˆ¶çš„ä½œç”¨èŒƒå›´**
- **è¡Œå†…å¤„ç†**ï¼šåœ¨å¤„ç†æ¯ä¸€è¡Œæ—¶çš„é€»è¾‘æ§åˆ¶
- **è®°å½•ç­›é€‰**ï¼šå†³å®šå“ªäº›è¡Œéœ€è¦å¤„ç†
- **æ•°æ®ç»Ÿè®¡**ï¼šæ§åˆ¶ç´¯è®¡å’Œè®¡ç®—é€»è¾‘
- **è¾“å‡ºæ ¼å¼**ï¼šæ§åˆ¶ç»“æœçš„å‘ˆç°æ–¹å¼

### 1.3 æµç¨‹æ§åˆ¶åˆ†ç±»æ¦‚è§ˆ



```
awkæµç¨‹æ§åˆ¶ä½“ç³»ï¼š

é¡ºåºç»“æ„ï¼š   è¯­å¥1 â†’ è¯­å¥2 â†’ è¯­å¥3
           â†“
æ¡ä»¶ç»“æ„ï¼š   if-else åˆ†æ”¯åˆ¤æ–­
           â†“  
å¾ªç¯ç»“æ„ï¼š   for/while é‡å¤æ‰§è¡Œ
           â†“
è·³è½¬æ§åˆ¶ï¼š   break/continue/exit
```

---

## 2. ğŸ”€ æ¡ä»¶è¯­å¥(if-else)



### 2.1 åŸºæœ¬ifè¯­å¥ç»“æ„



**ğŸ“‹ ifè¯­å¥è¯­æ³•**
```
åŸºæœ¬æ ¼å¼ï¼š
if (æ¡ä»¶è¡¨è¾¾å¼) {
    æ‰§è¡Œè¯­å¥
}

å®é™…åº”ç”¨ä¸¾ä¾‹ï¼š
awk '{if ($3 > 60) print $1 " åŠæ ¼"}' grades.txt
```

**ğŸ’¡ æ¡ä»¶è¡¨è¾¾å¼è¯¦è§£**
æ¡ä»¶è¡¨è¾¾å¼å°±æ˜¯ä¸€ä¸ªèƒ½äº§ç”ŸçœŸ(1)æˆ–å‡(0)ç»“æœçš„è¡¨è¾¾å¼ï¼š
- **æ•°å€¼æ¯”è¾ƒ**ï¼š`$3 > 60` (ç¬¬ä¸‰åˆ—å¤§äº60)
- **å­—ç¬¦ä¸²æ¯”è¾ƒ**ï¼š`$2 == "å¼ ä¸‰"` (ç¬¬äºŒåˆ—ç­‰äº"å¼ ä¸‰") 
- **æ¨¡å¼åŒ¹é…**ï¼š`$0 ~ /error/` (æ•´è¡ŒåŒ…å«"error")

### 2.2 if-elseå®Œæ•´ç»“æ„



**ğŸ”§ å®Œæ•´æ¡ä»¶åˆ†æ”¯**
```bash
# å¤„ç†å­¦ç”Ÿæˆç»©ï¼Œè¾“å‡ºç­‰çº§

awk '{
    if ($2 >= 90) {
        grade = "ä¼˜ç§€"
    } else if ($2 >= 80) {
        grade = "è‰¯å¥½"  
    } else if ($2 >= 60) {
        grade = "åŠæ ¼"
    } else {
        grade = "ä¸åŠæ ¼"
    }
    print $1, $2, grade
}' scores.txt
```

**ğŸ“Š æ¡ä»¶è¿ç®—ç¬¦æ±‡æ€»**

| **è¿ç®—ç¬¦** | **å«ä¹‰** | **ç¤ºä¾‹** | **è¯´æ˜** |
|-----------|---------|----------|----------|
| `>` `<` | å¤§äºå°äº | `$3 > 100` | æ•°å€¼æ¯”è¾ƒ |
| `>=` `<=` | å¤§äºç­‰äº | `$2 >= 60` | åŒ…å«è¾¹ç•Œå€¼ |
| `==` `!=` | ç­‰äºä¸ç­‰ | `$1 == "root"` | ç²¾ç¡®åŒ¹é… |
| `~` `!~` | åŒ¹é…ä¸åŒ¹é… | `$0 ~ /^#/` | æ­£åˆ™è¡¨è¾¾å¼ |
| `&&` `\|\|` | é€»è¾‘ä¸æˆ– | `$3>60 && $4<100` | ç»„åˆæ¡ä»¶ |

### 2.3 æ¡ä»¶è¯­å¥å®æˆ˜åº”ç”¨



**ğŸ¯ æ—¥å¿—åˆ†æç¤ºä¾‹**
```bash
# åˆ†æWebè®¿é—®æ—¥å¿—ï¼Œç»Ÿè®¡ä¸åŒçŠ¶æ€ç 

awk '{
#    # å‡è®¾ç¬¬9åˆ—æ˜¯HTTPçŠ¶æ€ç 
    if ($9 >= 200 && $9 < 300) {
        success++
    } else if ($9 >= 400 && $9 < 500) {
        client_error++
    } else if ($9 >= 500) {
        server_error++
    }
} END {
    print "æˆåŠŸè¯·æ±‚:", success
    print "å®¢æˆ·ç«¯é”™è¯¯:", client_error  
    print "æœåŠ¡å™¨é”™è¯¯:", server_error
}' access.log
```

**ğŸ’° æ•°æ®å¤„ç†åº”ç”¨**
```bash
# å¤„ç†é”€å”®æ•°æ®ï¼Œè®¡ç®—å¥–é‡‘

awk -F',' '{
#    # é”€å”®é¢åœ¨ç¬¬3åˆ—
    sales = $3
    
    if (sales >= 10000) {
        bonus = sales * 0.1
        level = "é‡‘ç‰Œ"
    } else if (sales >= 5000) {
        bonus = sales * 0.05
        level = "é“¶ç‰Œ"
    } else {
        bonus = sales * 0.02
        level = "é“œç‰Œ"
    }
    
    printf "%s\t%s\t%.2f\t%.2f\n", $1, level, sales, bonus
}' sales.csv
```

---

## 3. ğŸ”„ å¾ªç¯è¯­å¥(for while)



### 3.1 forå¾ªç¯è¯¦è§£



**ğŸ“‹ forå¾ªç¯çš„ä¸‰ç§å½¢å¼**

**ğŸ”¸ Cé£æ ¼forå¾ªç¯**
```bash
# è¯­æ³•ï¼šfor (åˆå§‹åŒ–; æ¡ä»¶; æ›´æ–°) { æ‰§è¡Œä½“ }

awk 'BEGIN {
    for (i = 1; i <= 5; i++) {
        print "å¾ªç¯ç¬¬", i, "æ¬¡"
    }
}'
```

**ğŸ”¸ for-inéå†æ•°ç»„**
```bash
# ç»Ÿè®¡æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°

awk '{
    for (i = 1; i <= NF; i++) {
        word_count[$i]++
    }
} END {
    for (word in word_count) {
        print word, word_count[word]
    }
}' text.txt
```

**ğŸ”¸ foréå†å­—æ®µ**
```bash
# å¤„ç†æ¯ä¸€è¡Œçš„æ‰€æœ‰å­—æ®µ

awk '{
    total = 0
    for (i = 1; i <= NF; i++) {
        if ($i ~ /^[0-9]+$/) {  # å¦‚æœæ˜¯æ•°å­—
            total += $i
        }
    }
    print "è¡Œ", NR, "æ•°å­—æ€»å’Œ:", total
}' data.txt
```

### 3.2 whileå¾ªç¯åº”ç”¨



**ğŸ”„ whileå¾ªç¯è¯­æ³•å’Œä½¿ç”¨**
```bash
# whileå¾ªç¯è¯­æ³•ï¼šwhile (æ¡ä»¶) { æ‰§è¡Œä½“ }


# ç¤ºä¾‹ï¼šå¤„ç†å¤šä½æ•°ï¼Œæå–æ¯ä¸€ä½æ•°å­—

awk '{
    num = $1
    digit_sum = 0
    
    while (num > 0) {
        digit = num % 10    # å–æœ€åä¸€ä½
        digit_sum += digit
        num = int(num / 10) # å»æ‰æœ€åä¸€ä½
    }
    
    print $1, "å„ä½æ•°å­—ä¹‹å’Œ:", digit_sum
}' numbers.txt
```

**ğŸ” whileåœ¨æ–‡æœ¬å¤„ç†ä¸­çš„å¦™ç”¨**
```bash
# ä»å­—ç¬¦ä¸²ä¸­æå–æ‰€æœ‰æ•°å­—

awk '{
    str = $0
    pos = 1
    
    while (match(str, /[0-9]+/, arr)) {
        print "æ‰¾åˆ°æ•°å­—:", substr(str, RSTART, RLENGTH)
        str = substr(str, RSTART + RLENGTH)
    }
}' mixed_text.txt
```

### 3.3 å¾ªç¯è¯­å¥å¯¹æ¯”é€‰æ‹©



**ğŸ“Š for vs while é€‰æ‹©æŒ‡å—**

| **åœºæ™¯** | **æ¨èä½¿ç”¨** | **åŸå› ** |
|---------|-------------|----------|
| å·²çŸ¥å¾ªç¯æ¬¡æ•° | `for (i=1; i<=n; i++)` | è®¡æ•°æ¸…æ™° |
| éå†æ•°ç»„ | `for (key in array)` | è¯­æ³•ç®€æ´ |
| æ¡ä»¶å¾ªç¯ | `while (condition)` | é€»è¾‘æ¸…æ™° |
| å¤„ç†å­—æ®µ | `for (i=1; i<=NF; i++)` | å­—æ®µä¸“ç”¨ |

---

## 4. â­ï¸ è·³è½¬è¯­å¥(break continue)



### 4.1 breakè¯­å¥ - å®Œå…¨è·³å‡º



**ğŸ›‘ breakçš„ä½œç”¨æœºåˆ¶**
breakè¯­å¥ä¼šç«‹å³è·³å‡ºå½“å‰å¾ªç¯ï¼Œä¸å†æ‰§è¡Œå¾ªç¯å†…çš„ä»»ä½•ä»£ç ï¼Œä¹Ÿä¸æ£€æŸ¥å¾ªç¯æ¡ä»¶ã€‚

```bash
# æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äº100çš„æ•°å­—ååœæ­¢

awk '{
    for (i = 1; i <= NF; i++) {
        if ($i > 100) {
            print "æ‰¾åˆ°å¤§æ•°:", $i, "åœ¨ç¬¬", i, "åˆ—"
            break  # æ‰¾åˆ°åç«‹å³é€€å‡ºå¾ªç¯
        }
    }
}' numbers.txt
```

**ğŸ“ breakåœ¨åµŒå¥—å¾ªç¯ä¸­çš„è¡Œä¸º**
breakåªä¼šè·³å‡ºæœ€å†…å±‚çš„å¾ªç¯ï¼š
```bash
awk 'BEGIN {
    for (i = 1; i <= 3; i++) {
        print "å¤–å±‚å¾ªç¯", i
        for (j = 1; j <= 5; j++) {
            if (j == 3) break  # åªè·³å‡ºå†…å±‚å¾ªç¯
            print "  å†…å±‚å¾ªç¯", j
        }
    }
}'
```

### 4.2 continueè¯­å¥ - è·³è¿‡å½“æ¬¡



**â­ï¸ continueçš„ä½œç”¨æœºåˆ¶**  
continueä¼šè·³è¿‡æœ¬æ¬¡å¾ªç¯å‰©ä½™çš„ä»£ç ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚

```bash
# åªå¤„ç†æ­£æ•°ï¼Œè·³è¿‡è´Ÿæ•°å’Œé›¶

awk '{
    total = 0
    count = 0
    
    for (i = 1; i <= NF; i++) {
        if ($i <= 0) {
            continue  # è·³è¿‡éæ­£æ•°
        }
        total += $i
        count++
    }
    
    if (count > 0) {
        print "æ­£æ•°å¹³å‡å€¼:", total/count
    }
}' numbers.txt
```

### 4.3 è·³è½¬è¯­å¥å®æˆ˜æŠ€å·§



**ğŸ¯ æ•°æ®æ¸…æ´—åº”ç”¨**
```bash
# å¤„ç†CSVæ–‡ä»¶ï¼Œè·³è¿‡æ— æ•ˆè®°å½•

awk -F',' '{
#    # è·³è¿‡æ ‡é¢˜è¡Œ
    if (NR == 1) continue
    
#    # æ£€æŸ¥å¿…è¦å­—æ®µæ˜¯å¦ä¸ºç©º
    if ($1 == "" || $2 == "" || $3 == "") {
        print "è·³è¿‡æ— æ•ˆè®°å½•:", $0 > "/dev/stderr"
        continue
    }
    
#    # å¤„ç†æœ‰æ•ˆè®°å½•
    print $1, $2, $3
}' data.csv
```

**ğŸ” æŸ¥æ‰¾ç‰¹å®šæ¨¡å¼**
```bash
# åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾é”™è¯¯ï¼Œæ‰¾åˆ°5ä¸ªå°±åœæ­¢

awk '/error/ {
    error_count++
    print "é”™è¯¯", error_count ":", $0
    
    if (error_count >= 5) {
        print "å·²æ‰¾åˆ°5ä¸ªé”™è¯¯ï¼Œåœæ­¢æœç´¢"
        break
    }
}' system.log
```

---

## 5. ğŸ“ å‡½æ•°è°ƒç”¨æ§åˆ¶



### 5.1 å†…ç½®å‡½æ•°çš„æ§åˆ¶åº”ç”¨



**ğŸ”§ å­—ç¬¦ä¸²å‡½æ•°æ§åˆ¶æµç¨‹**
```bash
# æ ¹æ®å­—ç¬¦ä¸²é•¿åº¦å†³å®šå¤„ç†æ–¹å¼

awk '{
    len = length($1)
    
    if (len < 5) {
        result = toupper($1)  # çŸ­å­—ç¬¦ä¸²è½¬å¤§å†™
    } else if (len < 10) {
        result = tolower($1)  # ä¸­ç­‰é•¿åº¦è½¬å°å†™
    } else {
        result = substr($1, 1, 10) "..."  # é•¿å­—ç¬¦ä¸²æˆªæ–­
    }
    
    print result
}' names.txt
```

**ğŸ“Š æ•°å­¦å‡½æ•°æ§åˆ¶åº”ç”¨**
```bash
# æ ¹æ®æ•°å€¼èŒƒå›´åº”ç”¨ä¸åŒçš„æ•°å­¦å‡½æ•°

awk '{
    value = $1
    
    if (value < 0) {
        result = sqrt(-value) * -1  # è´Ÿæ•°çš„ç‰¹æ®Šå¤„ç†
    } else if (value > 100) {
        result = log(value)         # å¤§æ•°å–å¯¹æ•°
    } else {
        result = value * value      # æ­£å¸¸æ•°å¹³æ–¹
    }
    
    printf "%.2f -> %.2f\n", value, result
}' numbers.txt
```

### 5.2 è‡ªå®šä¹‰å‡½æ•°ä¸æ§åˆ¶ç»“æ„



**ğŸ—ï¸ å‡½æ•°å®šä¹‰ä¸è°ƒç”¨æ§åˆ¶**
```bash
# å®šä¹‰æ•°æ®éªŒè¯å‡½æ•°

function is_valid_email(email) {
    if (email ~ /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/) {
        return 1
    } else {
        return 0
    }
}

# ä¸»ç¨‹åºä¸­çš„æ§åˆ¶é€»è¾‘

{
    if (is_valid_email($2)) {
        valid_emails++
        print $1, $2, "æœ‰æ•ˆ"
    } else {
        invalid_emails++
        print $1, $2, "æ— æ•ˆ"
    }
}

END {
    print "æœ‰æ•ˆé‚®ç®±:", valid_emails
    print "æ— æ•ˆé‚®ç®±:", invalid_emails
}
```

### 5.3 å‡½æ•°è¿”å›å€¼æ§åˆ¶



**ğŸ”„ æ ¹æ®å‡½æ•°è¿”å›å€¼æ§åˆ¶ç¨‹åºæµç¨‹**
```bash
function check_file_type(filename) {
    if (filename ~ /\.txt$/) return "text"
    if (filename ~ /\.csv$/) return "csv"  
    if (filename ~ /\.log$/) return "log"
    return "unknown"
}

{
    file_type = check_file_type($1)
    
    if (file_type == "text") {
        print $1, "-> æ–‡æœ¬æ–‡ä»¶å¤„ç†"
    } else if (file_type == "csv") {
        print $1, "-> CSVæ•°æ®å¤„ç†"
    } else if (file_type == "log") {
        print $1, "-> æ—¥å¿—åˆ†æå¤„ç†"
    } else {
        print $1, "-> æœªçŸ¥ç±»å‹ï¼Œè·³è¿‡"
        continue
    }
}
```

---

## 6. ğŸ›¡ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶



### 6.1 awkä¸­çš„å¼‚å¸¸æƒ…å†µ



**âš ï¸ å¸¸è§å¼‚å¸¸åœºæ™¯**
awkè™½ç„¶æ²¡æœ‰ä¼ ç»Ÿçš„try-catchæœºåˆ¶ï¼Œä½†å¯ä»¥é€šè¿‡æ¡ä»¶åˆ¤æ–­é¢„é˜²å’Œå¤„ç†å¼‚å¸¸ï¼š

- **é™¤é›¶é”™è¯¯**ï¼šåˆ†æ¯ä¸º0çš„æƒ…å†µ
- **æ•°ç»„è¶Šç•Œ**ï¼šè®¿é—®ä¸å­˜åœ¨çš„æ•°ç»„å…ƒç´   
- **å­—ç¬¦ä¸²æ“ä½œå¼‚å¸¸**ï¼šsubstrç­‰å‡½æ•°çš„å‚æ•°é”™è¯¯
- **æ–‡ä»¶æ“ä½œå¤±è´¥**ï¼šè¯»å†™æ–‡ä»¶æƒé™é—®é¢˜

### 6.2 é¢„é˜²æ€§å¼‚å¸¸å¤„ç†



**ğŸ” æ•°æ®éªŒè¯å’Œä¿æŠ¤**
```bash
# å®‰å…¨çš„æ•°å­¦è¿ç®—

awk '{
#    # é™¤æ³•è¿ç®—ä¿æŠ¤
    if ($2 != 0) {
        ratio = $1 / $2
        print $1, "/", $2, "=", ratio
    } else {
        print $1, "é™¤æ•°ä¸ºé›¶ï¼Œè·³è¿‡è®¡ç®—"
    }
    
#    # æ•°ç»„è®¿é—®ä¿æŠ¤  
    if (NF >= 3) {
        print "ç¬¬ä¸‰åˆ—:", $3
    } else {
        print "åˆ—æ•°ä¸è¶³ï¼Œæ— ç¬¬ä¸‰åˆ—"
    }
    
#    # å­—ç¬¦ä¸²æˆªå–ä¿æŠ¤
    if (length($1) >= 5) {
        print "å‰5ä¸ªå­—ç¬¦:", substr($1, 1, 5)
    } else {
        print "å­—ç¬¦ä¸²å¤ªçŸ­:", $1
    }
}' data.txt
```

### 6.3 é”™è¯¯å¤„ç†ç­–ç•¥



**ğŸ› ï¸ å®¹é”™æœºåˆ¶è®¾è®¡**
```bash
# ç»¼åˆé”™è¯¯å¤„ç†ç¤ºä¾‹

awk 'BEGIN {
    error_count = 0
    processed = 0
}

{
#    # è®°å½•å¤„ç†çŠ¶æ€
    current_line = NR
    
#    # æ£€æŸ¥å­—æ®µæ•°é‡
    if (NF < 3) {
        error_count++
        print "é”™è¯¯: è¡Œ", NR, "å­—æ®µä¸è¶³" > "/dev/stderr"
        next  # è·³è¿‡è¿™ä¸€è¡Œ
    }
    
#    # æ£€æŸ¥æ•°æ®ç±»å‹
    if ($2 !~ /^[0-9]+(\.[0-9]+)?$/) {
        error_count++
        print "é”™è¯¯: è¡Œ", NR, "ç¬¬äºŒåˆ—ä¸æ˜¯æ•°å­—:", $2 > "/dev/stderr"
        next
    }
    
#    # æ­£å¸¸å¤„ç†
    processed++
    result = $1 * $2
    print $1, $2, result
}

END {
    print "å¤„ç†å®Œæˆ: æˆåŠŸ", processed, "è¡Œï¼Œé”™è¯¯", error_count, "è¡Œ" > "/dev/stderr"
    
    if (error_count > processed * 0.1) {
        print "è­¦å‘Š: é”™è¯¯ç‡è¿‡é«˜!" > "/dev/stderr"
        exit 1  # ä»¥é”™è¯¯çŠ¶æ€é€€å‡º
    }
}' data.txt
```

---

## 7. ğŸšª ç¨‹åºé€€å‡ºæ§åˆ¶(exit)



### 7.1 exitè¯­å¥çš„ä½œç”¨



**ğŸ”š exitè¯­å¥æœºåˆ¶**
exitè¯­å¥ç”¨äºç«‹å³ç»ˆæ­¢awkç¨‹åºçš„æ‰§è¡Œï¼š
- **exit 0**ï¼šæ­£å¸¸é€€å‡º
- **exit 1**ï¼šé”™è¯¯é€€å‡º  
- **exit n**ï¼šæŒ‡å®šé€€å‡ºç 

```bash
# æŸ¥æ‰¾ç‰¹å®šè®°å½•åç«‹å³é€€å‡º

awk '{
    if ($1 == "target") {
        print "æ‰¾åˆ°ç›®æ ‡è®°å½•:", $0
        exit 0  # æ‰¾åˆ°åæ­£å¸¸é€€å‡º
    }
} END {
    if (NR == 0) {
        print "æ–‡ä»¶ä¸ºç©º"
        exit 1  # å¼‚å¸¸æƒ…å†µé€€å‡º
    }
}' search.txt
```

### 7.2 exitåœ¨ä¸åŒä½ç½®çš„è¡Œä¸º



**ğŸ“ exitä½ç½®å¯¹ç¨‹åºçš„å½±å“**

| **exitä½ç½®** | **è¡Œä¸º** | **ENDå—æ‰§è¡Œ** |
|-------------|---------|---------------|
| **BEGINå—** | ä¸å¤„ç†ä»»ä½•è¾“å…¥è¡Œ | âœ… ä¼šæ‰§è¡Œ |
| **ä¸»å¤„ç†å—** | åœæ­¢å¤„ç†åç»­è¡Œ | âœ… ä¼šæ‰§è¡Œ |  
| **ENDå—** | ç«‹å³é€€å‡ºç¨‹åº | âŒ ä¸å†æ‰§è¡Œ |

```bash
# æ¼”ç¤ºexitåœ¨ä¸åŒä½ç½®çš„æ•ˆæœ

awk 'BEGIN {
    if (ARGC < 2) {
        print "ç”¨æ³•: awk -f script.awk filename"
        exit 1  # BEGINä¸­exitï¼ŒENDä»ä¼šæ‰§è¡Œ
    }
}

/^#/ {
    comment_lines++
    if (comment_lines > 100) {
        print "æ³¨é‡Šè¡Œè¿‡å¤šï¼Œåœæ­¢å¤„ç†"
        exit 2  # ä¸»ä½“ä¸­exitï¼Œä¼šæ‰§è¡ŒEND
    }
}

END {
    print "å¤„ç†äº†", NR, "è¡Œï¼Œæ³¨é‡Šè¡Œ", comment_lines
#    # è¿™é‡Œçš„exitåªæ˜¯è®¾ç½®é€€å‡ºç 
}' script.awk input.txt
```

### 7.3 æ¡ä»¶é€€å‡ºæ§åˆ¶



**ğŸ¯ æ™ºèƒ½é€€å‡ºç­–ç•¥**
```bash
# æ•°æ®è´¨é‡æ£€æŸ¥ï¼Œè´¨é‡å·®æ—¶é€€å‡º

awk 'BEGIN {
    quality_threshold = 0.8
    total_records = 0
    valid_records = 0
}

{
    total_records++
    
#    # éªŒè¯è®°å½•è´¨é‡
    if (NF >= 3 && $2 ~ /^[0-9]+$/ && length($1) > 0) {
        valid_records++
#        # å¤„ç†æœ‰æ•ˆè®°å½•
        print $0
    }
    
#    # æ¯100è¡Œæ£€æŸ¥ä¸€æ¬¡è´¨é‡
    if (total_records % 100 == 0) {
        quality_rate = valid_records / total_records
        printf "è´¨é‡æ£€æŸ¥: %.2f%% (%d/%d)\n", 
               quality_rate*100, valid_records, total_records > "/dev/stderr"
               
        if (quality_rate < quality_threshold) {
            printf "æ•°æ®è´¨é‡è¿‡ä½ (%.2f%%), åœæ­¢å¤„ç†\n", 
                   quality_rate*100 > "/dev/stderr"
            exit 3
        }
    }
}

END {
    if (total_records > 0) {
        final_quality = valid_records / total_records
        printf "æœ€ç»ˆè´¨é‡: %.2f%% (%d/%d)\n", 
               final_quality*100, valid_records, total_records > "/dev/stderr"
    }
}' data.txt
```

---

## 8. ğŸ—ï¸ åµŒå¥—ç»“æ„ä½¿ç”¨



### 8.1 å¤šå±‚æ¡ä»¶åµŒå¥—



**ğŸ”€ å¤æ‚æ¡ä»¶åˆ¤æ–­æ ‘**
```bash
# å­¦ç”Ÿæˆç»©ç­‰çº§è¯„å®šç³»ç»Ÿ

awk -F',' '{
    name = $1
    math = $2  
    english = $3
    
#    # å¤šå±‚åµŒå¥—æ¡ä»¶åˆ¤æ–­
    if (math >= 90) {
        if (english >= 90) {
            grade = "A+"
            scholarship = "ç‰¹ç­‰å¥–å­¦é‡‘"
        } else if (english >= 80) {
            grade = "A"
            scholarship = "ä¸€ç­‰å¥–å­¦é‡‘"
        } else {
            grade = "B+"
            scholarship = "äºŒç­‰å¥–å­¦é‡‘"
        }
    } else if (math >= 80) {
        if (english >= 85) {
            grade = "A-" 
            scholarship = "ä¸€ç­‰å¥–å­¦é‡‘"
        } else if (english >= 70) {
            grade = "B"
            scholarship = "äºŒç­‰å¥–å­¦é‡‘"
        } else {
            grade = "B-"
            scholarship = "ä¸‰ç­‰å¥–å­¦é‡‘"
        }
    } else {
        grade = "C"
        scholarship = "æ— å¥–å­¦é‡‘"
    }
    
    print name, grade, scholarship
}' students.csv
```

### 8.2 å¾ªç¯åµŒå¥—åº”ç”¨



**ğŸ”„ åŒé‡å¾ªç¯å¤„ç†**
```bash
# çŸ©é˜µæ•°æ®å¤„ç†ï¼šè®¡ç®—æ¯è¡Œæ¯åˆ—çš„ç»Ÿè®¡ä¿¡æ¯

awk 'BEGIN {
    row_count = 0
}

{
    row_count++
    col_count = NF
    
#    # å­˜å‚¨çŸ©é˜µæ•°æ®
    for (j = 1; j <= NF; j++) {
        matrix[row_count][j] = $j
        row_sum[row_count] += $j
        col_sum[j] += $j
    }
}

END {
    print "çŸ©é˜µç»Ÿè®¡ç»“æœ:"
    print "============="
    
#    # åŒé‡å¾ªç¯ï¼šè¾“å‡ºå¸¦ç»Ÿè®¡çš„çŸ©é˜µ
    for (i = 1; i <= row_count; i++) {
        printf "è¡Œ%d: ", i
        
        for (j = 1; j <= col_count; j++) {
            printf "%6.2f ", matrix[i][j]
        }
        
        printf "| è¡Œå’Œ: %.2f\n", row_sum[i]
    }
    
#    # è¾“å‡ºåˆ—ç»Ÿè®¡
    printf "åˆ—å’Œ: "
    for (j = 1; j <= col_count; j++) {
        printf "%6.2f ", col_sum[j]
    }
    printf "\n"
}' matrix.txt
```

### 8.3 åµŒå¥—ç»“æ„æœ€ä½³å®è·µ



**ğŸ“‹ ä»£ç ç»„ç»‡åŸåˆ™**

**ğŸ”¸ å¯è¯»æ€§ä¼˜å…ˆ**
```bash
# æ¨èï¼šæ¸…æ™°çš„ç¼©è¿›å’Œæ³¨é‡Š

if (condition1) {
#    # å¤„ç†æƒ…å†µ1
    if (sub_condition) {
#        # å­æƒ…å†µå¤„ç†
        action1()
    } else {
#        # å¦ä¸€ä¸ªå­æƒ…å†µ
        action2()  
    }
} else {
#    # å¤„ç†æƒ…å†µ2
    action3()
}
```

**ğŸ”¸ é¿å…è¿‡åº¦åµŒå¥—**
```bash
# ä¸æ¨èï¼šè¿‡æ·±çš„åµŒå¥—

if (a) {
    if (b) {
        if (c) {
            if (d) {
#                # éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤
            }
        }
    }
}

# æ¨èï¼šä½¿ç”¨early returnå‡å°‘åµŒå¥—

if (!a) next
if (!b) next  
if (!c) next
if (!d) next

# ä¸»è¦é€»è¾‘

print "å¤„ç†æ•°æ®"
```

**ğŸ”¸ åŠŸèƒ½æ¨¡å—åŒ–**
```bash
# å°†å¤æ‚åµŒå¥—é€»è¾‘å°è£…æˆå‡½æ•°

function validate_record(fields) {
    if (fields < 3) return 0
    if ($2 !~ /^[0-9]+$/) return 0
    if (length($1) == 0) return 0
    return 1
}

function process_record() {
    if (validate_record(NF)) {
#        # å¤„ç†æœ‰æ•ˆè®°å½•
        return calculate_result($2, $3)
    } else {
#        # å¤„ç†æ— æ•ˆè®°å½•
        return 0
    }
}

# ä¸»é€»è¾‘å˜å¾—ç®€æ´

{
    result = process_record()
    print $1, result
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ æ¡ä»¶è¯­å¥ï¼šif-elseç”¨äºå†³ç­–åˆ†æ”¯ï¼Œè®©ç¨‹åºèƒ½æ ¹æ®ä¸åŒæƒ…å†µæ‰§è¡Œä¸åŒä»£ç 
ğŸ”¸ å¾ªç¯è¯­å¥ï¼šfor/whileç”¨äºé‡å¤æ‰§è¡Œï¼Œå¤„ç†æ‰¹é‡æ•°æ®å’Œéå†æ“ä½œ  
ğŸ”¸ è·³è½¬æ§åˆ¶ï¼šbreakå®Œå…¨è·³å‡ºå¾ªç¯ï¼Œcontinueè·³è¿‡å½“æ¬¡ç»§ç»­ä¸‹æ¬¡
ğŸ”¸ ç¨‹åºé€€å‡ºï¼šexitç«‹å³ç»ˆæ­¢ç¨‹åºï¼Œå¯æŒ‡å®šé€€å‡ºçŠ¶æ€ç 
ğŸ”¸ åµŒå¥—ç»“æ„ï¼šå¤šå±‚æ§åˆ¶ç»“æ„ç»„åˆï¼Œå®ç°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ awkæµç¨‹æ§åˆ¶çš„ç‹¬ç‰¹æ€§**
```
ä¸å…¶ä»–è¯­è¨€çš„åŒºåˆ«ï¼š
- awkæœ‰å†…ç½®çš„è¡Œå¤„ç†å¾ªç¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨è¯»å–æ–‡ä»¶
- æ¯ä¸€è¡Œè‡ªåŠ¨æ‹†åˆ†æˆå­—æ®µï¼Œä¾¿äºç›´æ¥å¤„ç†
- æ¨¡å¼åŒ¹é…ä¸åŠ¨ä½œç»“åˆï¼Œå¤©ç„¶é€‚åˆæ–‡æœ¬å¤„ç†

å®ç”¨ä»·å€¼ï¼š
- è®©æ•°æ®å¤„ç†é€»è¾‘æ›´åŠ çµæ´»å’Œæ™ºèƒ½
- èƒ½å¤„ç†å¤æ‚çš„æ¡ä»¶åˆ¤æ–­å’Œæ•°æ®ç­›é€‰
- æ”¯æŒå¤§è§„æ¨¡æ–‡æœ¬æ•°æ®çš„æ‰¹é‡å¤„ç†
```

**ğŸ”¹ é€‰æ‹©åˆé€‚çš„æ§åˆ¶ç»“æ„**

| **åœºæ™¯** | **æ¨èç»“æ„** | **ç†ç”±** |
|---------|-------------|----------|
| æ ¹æ®æ¡ä»¶åˆ†ç±»å¤„ç† | `if-else if-else` | é€»è¾‘æ¸…æ™°ï¼Œæ˜“ç»´æŠ¤ |
| å¤„ç†æ‰€æœ‰å­—æ®µ | `for (i=1; i<=NF; i++)` | è‡ªåŠ¨é€‚åº”å­—æ®µæ•° |
| ç»Ÿè®¡å’Œç´¯è®¡ | `while + è®¡æ•°å™¨` | çµæ´»æ§åˆ¶æ¡ä»¶ |
| æŸ¥æ‰¾ç‰¹å®šæ•°æ® | `if + break` | æ‰¾åˆ°å³åœï¼Œæ•ˆç‡é«˜ |
| æ•°æ®éªŒè¯ | `continue` | è·³è¿‡æ— æ•ˆæ•°æ® |

### 9.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ æ–‡æœ¬å¤„ç†åœºæ™¯**
- **æ—¥å¿—åˆ†æ**ï¼šæ ¹æ®æ—¥å¿—çº§åˆ«å’Œæ—¶é—´è¿›è¡Œåˆ†ç±»ç»Ÿè®¡
- **æ•°æ®æ¸…æ´—**ï¼šè¯†åˆ«å’Œå¤„ç†æ— æ•ˆã€ç¼ºå¤±çš„æ•°æ®è®°å½•
- **æŠ¥è¡¨ç”Ÿæˆ**ï¼šæŒ‰æ¡ä»¶ç­›é€‰æ•°æ®ï¼Œè®¡ç®—ç»Ÿè®¡æŒ‡æ ‡
- **é…ç½®æ–‡ä»¶å¤„ç†**ï¼šè§£æå’Œä¿®æ”¹å„ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶

**ğŸ› ï¸ ç¼–ç¨‹æœ€ä½³å®è·µ**
```
ä»£ç ç»„ç»‡ï¼š
- å¤æ‚é€»è¾‘è¦åˆ†è§£æˆå°çš„åŠŸèƒ½å—
- åˆç†ä½¿ç”¨ç©ºè¡Œå’Œæ³¨é‡Šå¢å¼ºå¯è¯»æ€§  
- é¿å…è¿‡æ·±çš„åµŒå¥—ï¼Œä¼˜å…ˆä½¿ç”¨early return

æ€§èƒ½ä¼˜åŒ–ï¼š
- å°½æ—©è¿‡æ»¤ä¸éœ€è¦çš„æ•°æ®(ä½¿ç”¨continue)
- æ‰¾åˆ°ç›®æ ‡åç«‹å³é€€å‡º(ä½¿ç”¨break/exit)
- åˆç†ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

é”™è¯¯å¤„ç†ï¼š
- æ£€æŸ¥æ•°æ®çš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§
- å¯¹å¼‚å¸¸æƒ…å†µç»™å‡ºæ˜ç¡®çš„é”™è¯¯æç¤º
- è®¾ç½®åˆé€‚çš„é€€å‡ºçŠ¶æ€ç 
```

### 9.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



- [ ] èƒ½å¤Ÿç¼–å†™åŸºæœ¬çš„if-elseæ¡ä»¶åˆ¤æ–­
- [ ] æŒæ¡forå’Œwhileä¸¤ç§å¾ªç¯çš„ä½¿ç”¨åœºæ™¯
- [ ] ç†è§£breakå’Œcontinueçš„åŒºåˆ«å’Œåº”ç”¨
- [ ] ä¼šä½¿ç”¨exitæ§åˆ¶ç¨‹åºé€€å‡º
- [ ] èƒ½å¤Ÿè®¾è®¡åˆç†çš„åµŒå¥—ç»“æ„
- [ ] æŒæ¡awkä¸­çš„å¼‚å¸¸å¤„ç†æ–¹æ³•

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
- **æ¡ä»¶åˆ†æ”¯**ï¼šifå†³å®šèµ°å“ªæ¡è·¯ï¼Œelseå¤„ç†å…¶ä»–æƒ…å†µ
- **å¾ªç¯é‡å¤**ï¼šforé€‚åˆå·²çŸ¥æ¬¡æ•°ï¼Œwhileé€‚åˆæœªçŸ¥æ¡ä»¶
- **è·³è½¬æ§åˆ¶**ï¼šbreakè·³å‡ºå»ï¼Œcontinueè·³è¿‡å»
- **ç¨‹åºé€€å‡º**ï¼šexitè¯´å†è§ï¼ŒçŠ¶æ€ç è¡¨å¿ƒæ„

**ğŸ’¡ è¿›é˜¶å­¦ä¹ å»ºè®®**
- å­¦ä¹ awkçš„é«˜çº§åŠŸèƒ½ï¼šè‡ªå®šä¹‰å‡½æ•°ã€å¤šç»´æ•°ç»„
- ç ”ç©¶awkä¸å…¶ä»–å·¥å…·çš„ç»„åˆä½¿ç”¨ï¼šgrep+awk+sed
- å®è·µå¤æ‚çš„æ•°æ®å¤„ç†é¡¹ç›®ï¼šæ—¥å¿—åˆ†æã€æ•°æ®ç»Ÿè®¡
- äº†è§£gawk(GNU awk)çš„æ‰©å±•ç‰¹æ€§å’Œè°ƒè¯•åŠŸèƒ½