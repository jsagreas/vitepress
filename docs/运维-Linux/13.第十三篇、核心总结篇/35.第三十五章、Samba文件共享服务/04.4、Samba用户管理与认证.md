---
title: 4ã€Sambaç”¨æˆ·ç®¡ç†ä¸è®¤è¯
---
## ğŸ“š ç›®å½•

1. [Sambaç”¨æˆ·ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-Sambaç”¨æˆ·ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [smbpasswdç”¨æˆ·ç®¡ç†å·¥å…·](#2-smbpasswdç”¨æˆ·ç®¡ç†å·¥å…·)
3. [pdbeditç”¨æˆ·æ•°æ®åº“ç®¡ç†](#3-pdbeditç”¨æˆ·æ•°æ®åº“ç®¡ç†)
4. [Sambaç”¨æˆ·ä¸Linuxç³»ç»Ÿç”¨æˆ·å…³ç³»](#4-Sambaç”¨æˆ·ä¸Linuxç³»ç»Ÿç”¨æˆ·å…³ç³»)
5. [ç”¨æˆ·å¯†ç åŒæ­¥æœºåˆ¶](#5-ç”¨æˆ·å¯†ç åŒæ­¥æœºåˆ¶)
6. [ç”¨æˆ·å¯ç”¨ç¦ç”¨ç®¡ç†](#6-ç”¨æˆ·å¯ç”¨ç¦ç”¨ç®¡ç†)
7. [guestç”¨æˆ·è®¿é—®é…ç½®](#7-guestç”¨æˆ·è®¿é—®é…ç½®)
8. [ç”¨æˆ·ç»„æƒé™æ˜ å°„](#8-ç”¨æˆ·ç»„æƒé™æ˜ å°„)
9. [å¯†ç ç­–ç•¥é…ç½®](#9-å¯†ç ç­–ç•¥é…ç½®)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Sambaç”¨æˆ·ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Sambaç”¨æˆ·ç®¡ç†

ğŸ¯ **ç®€å•ç†è§£**ï¼šSambaç”¨æˆ·ç®¡ç†å°±åƒç»™å…¬å¸å†…éƒ¨ç½‘ç»œè®¾ç½®"é—¨å«ç³»ç»Ÿ"

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
å…¬å¸å¤§æ¥¼è¿›å‡ºç®¡ç†ï¼š
- å‘˜å·¥éœ€è¦å·¥å¡è¿›å…¥å¤§æ¥¼
- ä¸åŒå‘˜å·¥æœ‰ä¸åŒæƒé™
- è®¿å®¢éœ€è¦ä¸´æ—¶é€šè¡Œè¯
- ç¦»èŒå‘˜å·¥æƒé™ç«‹å³å–æ¶ˆ

Sambaç”¨æˆ·ç®¡ç†ï¼š
- ç”¨æˆ·éœ€è¦è´¦å·è®¿é—®å…±äº«
- ä¸åŒç”¨æˆ·æœ‰ä¸åŒæ–‡ä»¶æƒé™  
- å¯è®¾ç½®åŒ¿åè®¿é—®
- å¯éšæ—¶å¯ç”¨æˆ–ç¦ç”¨ç”¨æˆ·
```

**ğŸ”¸ Sambaè®¤è¯çš„æ ¸å¿ƒä»·å€¼**
```
å®‰å…¨æ§åˆ¶ï¼š
- é˜²æ­¢æœªæˆæƒç”¨æˆ·è®¿é—®å…±äº«æ–‡ä»¶
- ç¡®ä¿æ•æ„Ÿæ•°æ®ä¸è¢«æ³„éœ²
- æä¾›è®¿é—®æ—¥å¿—å’Œå®¡è®¡åŠŸèƒ½

æƒé™ç®¡ç†ï¼š
- ç²¾ç¡®æ§åˆ¶ç”¨æˆ·è®¿é—®èŒƒå›´
- æ”¯æŒåªè¯»ã€è¯»å†™ç­‰ä¸åŒæƒé™
- å¯æŒ‰ç”¨æˆ·ç»„æ‰¹é‡ç®¡ç†æƒé™

ç”¨æˆ·ä½“éªŒï¼š
- å•ç‚¹ç™»å½•å‡å°‘å¯†ç è®°å¿†è´Ÿæ‹…
- è‡ªåŠ¨æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨
- æ”¯æŒå¤šå¹³å°å®¢æˆ·ç«¯è®¿é—®
```

### 1.2 Sambaç”¨æˆ·ç±»å‹è¯¦è§£

**ğŸ“Š ä¸åŒç”¨æˆ·ç±»å‹å¯¹æ¯”**

| ç”¨æˆ·ç±»å‹ | **è®¿é—®æƒé™** | **å¯†ç è¦æ±‚** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| ğŸ”¸ **æœ¬åœ°ç”¨æˆ·** | `å®Œæ•´æƒé™` | `éœ€è¦å¯†ç ` | `å†…éƒ¨å‘˜å·¥è®¿é—®` |
| ğŸ”¸ **Guestç”¨æˆ·** | `å—é™æƒé™` | `æ— éœ€å¯†ç ` | `ä¸´æ—¶è®¿å®¢è®¿é—®` |
| ğŸ”¸ **åŸŸç”¨æˆ·** | `åŸºäºåŸŸç­–ç•¥` | `åŸŸè®¤è¯` | `ä¼ä¸šåŸŸç¯å¢ƒ` |
| ğŸ”¸ **ç¦ç”¨ç”¨æˆ·** | `æ— æ³•è®¿é—®` | `ä¿ç•™å¯†ç ` | `ä¸´æ—¶åœç”¨è´¦å·` |

### 1.3 Sambaè®¤è¯æµç¨‹

**ğŸ”„ ç”¨æˆ·è®¤è¯è¿‡ç¨‹è¯¦è§£**

```
å®¢æˆ·ç«¯è®¤è¯æµç¨‹ï¼š
ç¬¬1æ­¥ï¼šç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
ç¬¬2æ­¥ï¼šSambaæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
ç¬¬3æ­¥ï¼šéªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®
ç¬¬4æ­¥ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¢«å¯ç”¨
ç¬¬5æ­¥ï¼šè¿”å›è®¤è¯ç»“æœ

æŠ€æœ¯å®ç°è¿‡ç¨‹ï¼š
å®¢æˆ·ç«¯ â†’ å‘é€è®¤è¯è¯·æ±‚ â†’ SambaæœåŠ¡å™¨
       â† è´¨è¯¢å“åº”       â†
       â†’ åŠ å¯†å¯†ç å“åº”   â†’
       â† è®¤è¯ç»“æœ      â†
```

**âš¡ è®¤è¯å®‰å…¨æœºåˆ¶**
```
å¯†ç åŠ å¯†ï¼š
- ä½¿ç”¨NTLMv2åŠ å¯†ç®—æ³•
- å¯†ç ä¸ä»¥æ˜æ–‡ä¼ è¾“
- æ”¯æŒKerberosè®¤è¯

é˜²æš´åŠ›ç ´è§£ï¼š
- è¿ç»­å¤±è´¥æ¬¡æ•°é™åˆ¶
- è´¦æˆ·ä¸´æ—¶é”å®šæœºåˆ¶
- IPåœ°å€è®¿é—®æ§åˆ¶

ä¼šè¯ç®¡ç†ï¼š
- ç”¨æˆ·ç™»å½•çŠ¶æ€è·Ÿè¸ª
- ä¼šè¯è¶…æ—¶è‡ªåŠ¨æ–­å¼€
- å¹¶å‘è¿æ¥æ•°é™åˆ¶
```

---

## 2. ğŸ”§ smbpasswdç”¨æˆ·ç®¡ç†å·¥å…·


### 2.1 smbpasswdå·¥å…·åŸºç¡€ç”¨æ³•

ğŸ¯ **smbpasswdå°±åƒå…¬å¸çš„"å‘˜å·¥å¡ç®¡ç†ç³»ç»Ÿ"**

**ğŸ”¸ åŸºæœ¬æ“ä½œå‘½ä»¤**
- **æ·»åŠ ç”¨æˆ·**ï¼š`smbpasswd -a username`
- **åˆ é™¤ç”¨æˆ·**ï¼š`smbpasswd -x username`
- **ä¿®æ”¹å¯†ç **ï¼š`smbpasswd username`
- **å¯ç”¨ç”¨æˆ·**ï¼š`smbpasswd -e username`
- **ç¦ç”¨ç”¨æˆ·**ï¼š`smbpasswd -d username`

### 2.2 æ·»åŠ Sambaç”¨æˆ·å®æˆ˜

**ğŸ“ åˆ›å»ºæ–°ç”¨æˆ·çš„å®Œæ•´æµç¨‹**

```bash
# æ­¥éª¤1ï¼šåˆ›å»ºLinuxç³»ç»Ÿç”¨æˆ·ï¼ˆå¿…é¡»å…ˆå­˜åœ¨ï¼‰
sudo useradd -m shareuser
sudo passwd shareuser

# æ­¥éª¤2ï¼šå°†ç”¨æˆ·æ·»åŠ åˆ°Sambaæ•°æ®åº“
sudo smbpasswd -a shareuser
# ç³»ç»Ÿæç¤ºè¾“å…¥Sambaå¯†ç ï¼ˆå¯ä»¥ä¸Linuxå¯†ç ä¸åŒï¼‰

# æ­¥éª¤3ï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦æ·»åŠ æˆåŠŸ
sudo pdbedit -L
```

**ğŸ’¡ æ‰¹é‡æ·»åŠ ç”¨æˆ·è„šæœ¬**
```bash
#!/bin/bash
# æ‰¹é‡æ·»åŠ Sambaç”¨æˆ·

USERLIST="user1 user2 user3 user4"
DEFAULT_PASSWORD="TempPass123"

for user in $USERLIST; do
    echo "åˆ›å»ºç”¨æˆ·: $user"
    
    # åˆ›å»ºLinuxç”¨æˆ·
    sudo useradd -m $user
    echo "$user:$DEFAULT_PASSWORD" | sudo chpasswd
    
    # æ·»åŠ Sambaç”¨æˆ·
    echo -e "$DEFAULT_PASSWORD\n$DEFAULT_PASSWORD" | sudo smbpasswd -a -s $user
    
    echo "ç”¨æˆ· $user åˆ›å»ºå®Œæˆ"
done

echo "æ‰€æœ‰ç”¨æˆ·åˆ›å»ºå®Œæ¯•ï¼Œè¯·æé†’ç”¨æˆ·é¦–æ¬¡ç™»å½•åä¿®æ”¹å¯†ç "
```

### 2.3 ç”¨æˆ·å¯†ç ç®¡ç†

**ğŸ”‘ å¯†ç ç­–ç•¥ä¸å®‰å…¨ç®¡ç†**

**ä¿®æ”¹ç”¨æˆ·å¯†ç çš„ä¸åŒæ–¹å¼**ï¼š
- **ç®¡ç†å‘˜ä¿®æ”¹**ï¼š`sudo smbpasswd username`
- **ç”¨æˆ·è‡ªå·±ä¿®æ”¹**ï¼š`smbpasswd`ï¼ˆéœ€è¦å…ˆç™»å½•ï¼‰
- **å¼ºåˆ¶é¦–æ¬¡ä¿®æ”¹**ï¼šè®¾ç½®å¯†ç è¿‡æœŸæ—¶é—´

**å¯†ç å®‰å…¨å¢å¼ºé…ç½®**
```ini
# åœ¨smb.confä¸­é…ç½®å¯†ç ç­–ç•¥
[global]
# å¯†ç å†å²è®°å½•ï¼Œé˜²æ­¢é‡å¤ä½¿ç”¨æ—§å¯†ç 
password history = 5

# å¯†ç æœ€å°é•¿åº¦
min password length = 8

# å¯†ç å¤æ‚åº¦è¦æ±‚
check password script = /usr/local/bin/password_check.sh

# å¯†ç è¿‡æœŸæ—¶é—´ï¼ˆå¤©ï¼‰
password expire = 90

# è´¦æˆ·é”å®šç­–ç•¥
lockout duration = 30
lockout threshold = 3
```

### 2.4 ç”¨æˆ·çŠ¶æ€ç®¡ç†

**ğŸ“Š ç”¨æˆ·å¯ç”¨ä¸ç¦ç”¨æ“ä½œ**

```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çŠ¶æ€
sudo pdbedit -L -v | grep -E "(Unix username|Account Flags)"

# ç¦ç”¨ç”¨æˆ·ï¼ˆä¸´æ—¶åœæ­¢è®¿é—®ï¼‰
sudo smbpasswd -d problematic_user

# å¯ç”¨ç”¨æˆ·ï¼ˆæ¢å¤è®¿é—®æƒé™ï¼‰
sudo smbpasswd -e problematic_user

# åˆ é™¤ç”¨æˆ·ï¼ˆå½»åº•ç§»é™¤ï¼‰
sudo smbpasswd -x former_employee

# æ‰¹é‡ç®¡ç†ç”¨æˆ·çŠ¶æ€
#!/bin/bash
# æ‰¹é‡ç¦ç”¨ç¦»èŒå‘˜å·¥
FORMER_EMPLOYEES="john jane mike"

for user in $FORMER_EMPLOYEES; do
    sudo smbpasswd -d $user
    echo "ç”¨æˆ· $user å·²è¢«ç¦ç”¨"
done
```

---

## 3. ğŸ—ƒï¸ pdbeditç”¨æˆ·æ•°æ®åº“ç®¡ç†


### 3.1 pdbeditå·¥å…·åŠŸèƒ½æ¦‚è§ˆ

ğŸ¯ **pdbeditæ˜¯Sambaçš„"é«˜çº§ç”¨æˆ·ç®¡ç†å·¥å…·"**

```
åŠŸèƒ½å¯¹æ¯”ï¼š
smbpasswdï¼šåŸºç¡€ç”¨æˆ·ç®¡ç†ï¼ˆå¢åˆ æ”¹å¯†ç ï¼‰
pdbeditï¼šé«˜çº§ç”¨æˆ·ç®¡ç†ï¼ˆè¯¦ç»†ä¿¡æ¯ã€æ‰¹é‡æ“ä½œã€å¯¼å…¥å¯¼å‡ºï¼‰

å°±åƒï¼š
smbpasswd = åŸºç¡€ç‰ˆå‘˜å·¥ç®¡ç†ç³»ç»Ÿ
pdbedit = ä¼ä¸šçº§HRç®¡ç†ç³»ç»Ÿ
```

**ğŸ”¸ pdbeditæ ¸å¿ƒåŠŸèƒ½**
- **ç”¨æˆ·ä¿¡æ¯æŸ¥çœ‹**ï¼šè¯¦ç»†ç”¨æˆ·å±æ€§å’ŒçŠ¶æ€
- **æ‰¹é‡ç”¨æˆ·æ“ä½œ**ï¼šå¯¼å…¥å¯¼å‡ºç”¨æˆ·æ•°æ®åº“
- **ç”¨æˆ·å±æ€§ä¿®æ”¹**ï¼šè®¾ç½®ç”¨æˆ·æè¿°ã€ä¸»ç›®å½•ç­‰
- **æ•°æ®åº“ç»´æŠ¤**ï¼šå¤‡ä»½æ¢å¤ç”¨æˆ·æ•°æ®åº“

### 3.2 ç”¨æˆ·ä¿¡æ¯æŸ¥çœ‹ä¸ç®¡ç†

**ğŸ“‹ è¯¦ç»†ç”¨æˆ·ä¿¡æ¯æ“ä½œ**

```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
sudo pdbedit -L

# æŸ¥çœ‹ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
sudo pdbedit -L -v username

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„å®Œæ•´ä¿¡æ¯
sudo pdbedit -u username -v
```

**ç”¨æˆ·ä¿¡æ¯åŒ…å«çš„å…³é”®å­—æ®µ**ï¼š
- **Unix username**ï¼šLinuxç³»ç»Ÿç”¨æˆ·å
- **NT username**ï¼šSambaç”¨æˆ·å
- **Account Flags**ï¼šè´¦æˆ·çŠ¶æ€æ ‡å¿—
- **User SID**ï¼šç”¨æˆ·å®‰å…¨æ ‡è¯†ç¬¦
- **Primary Group SID**ï¼šä¸»è¦ç»„æ ‡è¯†ç¬¦
- **Full Name**ï¼šç”¨æˆ·å…¨å
- **Home Directory**ï¼šç”¨æˆ·ä¸»ç›®å½•
- **Account desc**ï¼šè´¦æˆ·æè¿°

### 3.3 ç”¨æˆ·å±æ€§ä¿®æ”¹ç®¡ç†

**âš™ï¸ ç”¨æˆ·é«˜çº§å±æ€§é…ç½®**

**è®¾ç½®ç”¨æˆ·å®Œæ•´ä¿¡æ¯**ï¼š
```bash
# è®¾ç½®ç”¨æˆ·å…¨å
sudo pdbedit -u john -f "John Smith"

# è®¾ç½®ç”¨æˆ·æè¿°
sudo pdbedit -u john -c "Marketing Department Manager"

# è®¾ç½®ç”¨æˆ·ä¸»ç›®å½•
sudo pdbedit -u john -h "/home/shared/john"

# ç»¼åˆè®¾ç½®ç”¨æˆ·ä¿¡æ¯
sudo pdbedit -u john -f "John Smith" -c "Marketing Manager" -h "/home/john"
```

### 3.4 ç”¨æˆ·æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤

**ğŸ’¾ æ•°æ®åº“ç®¡ç†ä¸è¿ç§»**

```bash
# å¯¼å‡ºç”¨æˆ·æ•°æ®åº“
sudo pdbedit -e smbpasswd:/backup/samba_users.backup

# å¯¼å…¥ç”¨æˆ·æ•°æ®åº“
sudo pdbedit -i smbpasswd:/backup/samba_users.backup

# æ‰¹é‡æ·»åŠ ç”¨æˆ·ï¼ˆä»æ–‡ä»¶ï¼‰
# åˆ›å»ºç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ users.txt
echo "user1:1001:user1 description" > users.txt
echo "user2:1002:user2 description" >> users.txt

# æ‰¹é‡å¤„ç†è„šæœ¬
while IFS=':' read -r username uid description; do
    sudo useradd -u $uid $username
    echo -e "password123\npassword123" | sudo smbpasswd -a -s $username
    sudo pdbedit -u $username -c "$description"
done < users.txt
```

**ğŸ”’ æ•°æ®åº“å®‰å…¨ç®¡ç†**
```bash
# å®šæœŸå¤‡ä»½ç”¨æˆ·æ•°æ®åº“
#!/bin/bash
# backup_samba_users.sh

BACKUP_DIR="/backup/samba"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¯¼å‡ºç”¨æˆ·æ•°æ®
sudo pdbedit -e smbpasswd:$BACKUP_DIR/samba_users_$DATE.backup

# å¤‡ä»½é…ç½®æ–‡ä»¶
sudo cp /etc/samba/smb.conf $BACKUP_DIR/smb.conf_$DATE.backup

# æ¸…ç†7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.backup" -mtime +7 -delete

echo "Sambaç”¨æˆ·æ•°æ®åº“å¤‡ä»½å®Œæˆ: $DATE"
```

---

## 4. ğŸ”— Sambaç”¨æˆ·ä¸Linuxç³»ç»Ÿç”¨æˆ·å…³ç³»


### 4.1 ç”¨æˆ·å…³ç³»åŸºæœ¬åŸç†

ğŸ¯ **ç†è§£Sambaç”¨æˆ·ä¸Linuxç”¨æˆ·çš„"åŒé‡èº«ä»½"å…³ç³»**

```
åŒé‡èº«ä»½ç³»ç»Ÿï¼š

Linuxç³»ç»Ÿç”¨æˆ·ï¼š
- ç³»ç»Ÿçº§èº«ä»½è®¤è¯
- æ–‡ä»¶ç³»ç»Ÿæƒé™æ§åˆ¶
- è¿›ç¨‹æ‰€æœ‰è€…èº«ä»½

Sambaç”¨æˆ·ï¼š
- ç½‘ç»œå…±äº«è®¿é—®è®¤è¯
- SambaæœåŠ¡ä¸“ç”¨å¯†ç 
- ç½‘ç»œåè®®å±‚é¢çš„èº«ä»½

å…³ç³»æ¨¡å¼ï¼š
ä¸€ä¸ªLinuxç”¨æˆ· â†â†’ ä¸€ä¸ªSambaç”¨æˆ·ï¼ˆä¸€å¯¹ä¸€æ˜ å°„ï¼‰
```

**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦åŒé‡èº«ä»½**
```
æŠ€æœ¯åŸå› ï¼š
- Linuxä½¿ç”¨shadowå¯†ç ç³»ç»Ÿ
- Sambaéœ€è¦å…¼å®¹Windowsç½‘ç»œåè®®
- ä¸¤ç§ç³»ç»Ÿçš„å¯†ç åŠ å¯†æ–¹å¼ä¸åŒ

å®‰å…¨åŸå› ï¼š
- å¯ä»¥è®¾ç½®ä¸åŒçš„å¯†ç ç­–ç•¥
- ç½‘ç»œè®¿é—®ä¸æœ¬åœ°è®¿é—®åˆ†ç¦»ç®¡ç†
- æ›´çµæ´»çš„æƒé™æ§åˆ¶

ç®¡ç†åŸå› ï¼š
- å¯ä»¥åªå…è®¸ç½‘ç»œè®¿é—®è€Œä¸å…è®¸æœ¬åœ°ç™»å½•
- æ”¯æŒä¸åŒçš„ç”¨æˆ·ç®¡ç†å·¥å…·
- ä¾¿äºæ‰¹é‡ç”¨æˆ·ç®¡ç†
```

### 4.2 ç”¨æˆ·æ˜ å°„æœºåˆ¶è¯¦è§£

**ğŸ—ºï¸ ç”¨æˆ·èº«ä»½æ˜ å°„è§„åˆ™**

| åœºæ™¯ | **Linuxç”¨æˆ·çŠ¶æ€** | **Sambaç”¨æˆ·çŠ¶æ€** | **è®¿é—®ç»“æœ** |
|------|-----------------|-----------------|-------------|
| ğŸ”¸ **æ­£å¸¸ç”¨æˆ·** | `å­˜åœ¨ä¸”å¯ç”¨` | `å­˜åœ¨ä¸”å¯ç”¨` | `å¯ä»¥è®¿é—®` |
| ğŸ”¸ **ç¦ç”¨Samba** | `å­˜åœ¨ä¸”å¯ç”¨` | `å­˜åœ¨ä½†ç¦ç”¨` | `æ— æ³•è®¿é—®` |
| ğŸ”¸ **åˆ é™¤Linuxç”¨æˆ·** | `ä¸å­˜åœ¨` | `å­˜åœ¨ä¸”å¯ç”¨` | `æ— æ³•è®¿é—®` |
| ğŸ”¸ **æ–°å»ºæ˜ å°„** | `æ–°å»º` | `æœªåˆ›å»º` | `éœ€è¦æ·»åŠ Sambaç”¨æˆ·` |

**ç”¨æˆ·åˆ›å»ºçš„æ­£ç¡®é¡ºåº**ï¼š
1. **å…ˆåˆ›å»ºLinuxç³»ç»Ÿç”¨æˆ·**
2. **å†æ·»åŠ å¯¹åº”çš„Sambaç”¨æˆ·**
3. **è®¾ç½®é€‚å½“çš„æƒé™å’Œç»„å…³ç³»**

### 4.3 ç”¨æˆ·ä¸€è‡´æ€§ç®¡ç†

**âš–ï¸ ä¿æŒåŒé‡èº«ä»½çš„åŒæ­¥**

```bash
# æ£€æŸ¥ç”¨æˆ·ä¸€è‡´æ€§è„šæœ¬
#!/bin/bash
# check_user_consistency.sh

echo "=== Sambaç”¨æˆ·ä¸Linuxç”¨æˆ·ä¸€è‡´æ€§æ£€æŸ¥ ==="

# è·å–æ‰€æœ‰Linuxç”¨æˆ·
LINUX_USERS=$(getent passwd | cut -d: -f1)

# è·å–æ‰€æœ‰Sambaç”¨æˆ·
SAMBA_USERS=$(sudo pdbedit -L | cut -d: -f1)

echo "æ£€æŸ¥å­¤ç«‹çš„Sambaç”¨æˆ·ï¼ˆæ²¡æœ‰å¯¹åº”Linuxç”¨æˆ·ï¼‰ï¼š"
for samba_user in $SAMBA_USERS; do
    if ! getent passwd $samba_user > /dev/null; then
        echo "âš ï¸  å­¤ç«‹Sambaç”¨æˆ·: $samba_user"
    fi
done

echo "æ£€æŸ¥å¯èƒ½éœ€è¦æ·»åŠ Sambaç”¨æˆ·çš„Linuxç”¨æˆ·ï¼š"
for linux_user in $LINUX_USERS; do
    # è·³è¿‡ç³»ç»Ÿç”¨æˆ·
    if [[ $(id -u $linux_user) -ge 1000 ]]; then
        if ! sudo pdbedit -L | grep -q "^$linux_user:"; then
            echo "ğŸ’¡ Linuxç”¨æˆ· $linux_user å¯èƒ½éœ€è¦æ·»åŠ Sambaç”¨æˆ·"
        fi
    fi
done
```

### 4.4 ç”¨æˆ·æƒé™ç»§æ‰¿å…³ç³»

**ğŸ‘¥ ç»„æƒé™ä¸æ–‡ä»¶æƒé™çš„å…³ç³»**

```bash
# ç”¨æˆ·ç»„ç®¡ç†ç¤ºä¾‹
# åˆ›å»ºå·¥ä½œç»„
sudo groupadd marketing
sudo groupadd development

# å°†ç”¨æˆ·åŠ å…¥ç»„
sudo usermod -a -G marketing john
sudo usermod -a -G development jane

# åˆ›å»ºå¯¹åº”çš„å…±äº«ç›®å½•
sudo mkdir -p /srv/samba/marketing
sudo mkdir -p /srv/samba/development

# è®¾ç½®ç›®å½•æƒé™
sudo chown -R root:marketing /srv/samba/marketing
sudo chmod -R 775 /srv/samba/marketing

sudo chown -R root:development /srv/samba/development  
sudo chmod -R 775 /srv/samba/development

# è®¾ç½®SGIDä½ç¡®ä¿æ–°æ–‡ä»¶ç»§æ‰¿ç»„æƒé™
sudo chmod g+s /srv/samba/marketing
sudo chmod g+s /srv/samba/development
```

---

## 5. ğŸ”„ ç”¨æˆ·å¯†ç åŒæ­¥æœºåˆ¶


### 5.1 å¯†ç åŒæ­¥çš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

ğŸ¯ **å¯†ç åŒæ­¥å°±åƒ"åŒå¡åŒå¾…æ‰‹æœº"çš„åŒæ­¥é—®é¢˜**

```
å¯†ç ä¸åŒæ­¥çš„é—®é¢˜ï¼š
- ç”¨æˆ·éœ€è¦è®°å¿†ä¸¤å¥—å¯†ç 
- ç®¡ç†å‘˜éœ€è¦ç»´æŠ¤ä¸¤å¥—ç”¨æˆ·æ•°æ®
- å¯†ç æ›´æ–°æ—¶å®¹æ˜“å‡ºç°ä¸ä¸€è‡´

å¯†ç åŒæ­¥çš„å¥½å¤„ï¼š
- ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼ˆåªéœ€ä¸€ä¸ªå¯†ç ï¼‰
- ç®¡ç†å¤æ‚åº¦é™ä½
- å‡å°‘å¯†ç ç›¸å…³çš„æŠ€æœ¯æ”¯æŒ
```

### 5.2 Unixå¯†ç åŒæ­¥é…ç½®

**âš™ï¸ å¯ç”¨å¯†ç è‡ªåŠ¨åŒæ­¥**

åœ¨ `/etc/samba/smb.conf` ä¸­é…ç½®å¯†ç åŒæ­¥ï¼š
```ini
[global]
# å¯ç”¨Unixå¯†ç åŒæ­¥
unix password sync = yes

# å¯†ç åŒæ­¥ç¨‹åºè·¯å¾„
passwd program = /usr/bin/passwd %u

# å¯†ç èŠå¤©è„šæœ¬
passwd chat = "*Enter new password:*" %n\r "*Re-enter new password:*" %n\r "*Password changed successfully*"

# å¯ç”¨åŠ å¯†å¯†ç 
encrypt passwords = yes

# å¯†ç æœåŠ¡å™¨ï¼ˆå¦‚æœä½¿ç”¨åŸŸæ§åˆ¶å™¨ï¼‰
# password server = dc1.company.com dc2.company.com
```

**å¯†ç åŒæ­¥å·¥ä½œæµç¨‹**ï¼š
```
ç”¨æˆ·ä¿®æ”¹Sambaå¯†ç  â†’ Sambaè°ƒç”¨passwdç¨‹åº â†’ ä¿®æ”¹Linuxå¯†ç 
                 â†“
            ä¸¤ä¸ªå¯†ç ä¿æŒåŒæ­¥
```

### 5.3 PAMè®¤è¯é›†æˆ

**ğŸ” ä½¿ç”¨PAMå®ç°ç»Ÿä¸€è®¤è¯**

**é…ç½®PAMè®¤è¯æ”¯æŒ**ï¼š
```bash
# å®‰è£…å¿…è¦çš„PAMæ¨¡å—
sudo apt install libpam-smbpass

# ç¼–è¾‘PAMé…ç½®æ–‡ä»¶
sudo nano /etc/pam.d/passwd
```

åœ¨PAMé…ç½®ä¸­æ·»åŠ ï¼š
```
# åœ¨passwordéƒ¨åˆ†æ·»åŠ 
password required pam_smbpass.so nullok use_authtok
```

**éªŒè¯PAMé…ç½®æ•ˆæœ**ï¼š
```bash
# ç”¨æˆ·æ›´æ”¹å¯†ç æ—¶ä¼šåŒæ—¶æ›´æ–°ä¸¤ä¸ªç³»ç»Ÿ
passwd username
# è¿™ä¸ªå‘½ä»¤ç°åœ¨ä¼šåŒæ—¶æ›´æ–°Linuxå’ŒSambaå¯†ç 
```

### 5.4 ä¼ä¸šçº§å¯†ç ç­–ç•¥é…ç½®

**ğŸ›¡ï¸ ç»Ÿä¸€å¯†ç å®‰å…¨ç­–ç•¥**

```ini
# smb.confä¸­çš„é«˜çº§å¯†ç ç­–ç•¥
[global]
# å¯†ç å¤æ‚åº¦æ£€æŸ¥è„šæœ¬
check password script = /etc/samba/scripts/check_password.sh %u %n

# å¯†ç æœ€å°é•¿åº¦
min password length = 8

# å¯†ç å†å²è®°å½•
password history = 5

# æœºå™¨è´¦æˆ·å¯†ç æ›´æ–°é—´éš”
machine password timeout = 86400

# å¼ºåˆ¶å¯†ç å®šæœŸæ›´æ”¹
max password age = 90
min password age = 1
```

**å¯†ç å¤æ‚åº¦æ£€æŸ¥è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# /etc/samba/scripts/check_password.sh

USERNAME=$1
PASSWORD=$2

# æ£€æŸ¥å¯†ç é•¿åº¦
if [ ${#PASSWORD} -lt 8 ]; then
    echo "å¯†ç é•¿åº¦å¿…é¡»è‡³å°‘8ä½"
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦åŒ…å«æ•°å­—
if [[ ! $PASSWORD =~ [0-9] ]]; then
    echo "å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ•°å­—"
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦åŒ…å«å¤§å†™å­—æ¯
if [[ ! $PASSWORD =~ [A-Z] ]]; then
    echo "å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¤§å†™å­—æ¯"
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦åŒ…å«å°å†™å­—æ¯  
if [[ ! $PASSWORD =~ [a-z] ]]; then
    echo "å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå°å†™å­—æ¯"
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦
if [[ ! $PASSWORD =~ [^a-zA-Z0-9] ]]; then
    echo "å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦"
    exit 1
fi

# æ‰€æœ‰æ£€æŸ¥é€šè¿‡
echo "å¯†ç ç¬¦åˆå®‰å…¨ç­–ç•¥"
exit 0
```

---

## 6. âš¡ ç”¨æˆ·å¯ç”¨ç¦ç”¨ç®¡ç†


### 6.1 ç”¨æˆ·çŠ¶æ€ç®¡ç†ç­–ç•¥

ğŸ¯ **ç”¨æˆ·çŠ¶æ€ç®¡ç†å°±åƒ"å‘˜å·¥é—¨ç¦å¡ç®¡ç†"**

```
ç”¨æˆ·çŠ¶æ€ç±»å‹ï¼š
å¯ç”¨çŠ¶æ€ï¼šæ­£å¸¸ä½¿ç”¨ï¼Œäº«æœ‰å®Œæ•´æƒé™
ç¦ç”¨çŠ¶æ€ï¼šä¸´æ—¶åœç”¨ï¼Œä¿ç•™ç”¨æˆ·æ•°æ®
åˆ é™¤çŠ¶æ€ï¼šå®Œå…¨ç§»é™¤ï¼Œæ¸…ç†æ‰€æœ‰æ•°æ®

åº”ç”¨åœºæ™¯ï¼š
å¯ç”¨ï¼šæ–°å‘˜å·¥å…¥èŒã€å‘˜å·¥å¤èŒ
ç¦ç”¨ï¼šå‘˜å·¥è¯·å‡ã€ä¸´æ—¶è°ƒèŒã€å¯ç–‘æ´»åŠ¨
åˆ é™¤ï¼šå‘˜å·¥ç¦»èŒã€è´¦æˆ·æ¸…ç†
```

### 6.2 ç”¨æˆ·å¯ç”¨æ“ä½œè¯¦è§£

**âœ… å¯ç”¨ç”¨æˆ·çš„æ ‡å‡†æµç¨‹**

```bash
# å¯ç”¨è¢«ç¦ç”¨çš„ç”¨æˆ·
sudo smbpasswd -e username

# æ‰¹é‡å¯ç”¨ç”¨æˆ·
USERS_TO_ENABLE="john jane mike"
for user in $USERS_TO_ENABLE; do
    sudo smbpasswd -e $user
    echo "ç”¨æˆ· $user å·²å¯ç”¨"
done

# éªŒè¯ç”¨æˆ·çŠ¶æ€
sudo pdbedit -L -v username | grep "Account Flags"
# æ­£å¸¸çŠ¶æ€æ˜¾ç¤º: Account Flags: [U          ]
# U = User account (normal) 
```

**ç”¨æˆ·å¯ç”¨æ£€æŸ¥æ¸…å•**ï¼š
- âœ… ç¡®è®¤Linuxç”¨æˆ·å­˜åœ¨ä¸”æœ‰æ•ˆ
- âœ… ç¡®è®¤ç”¨æˆ·éœ€è¦çš„æƒé™å’Œç»„å…³ç³»
- âœ… æµ‹è¯•ç”¨æˆ·ç™»å½•åŠŸèƒ½
- âœ… æ£€æŸ¥ç”¨æˆ·ä¸»ç›®å½•æƒé™
- âœ… é€šçŸ¥ç”¨æˆ·è´¦æˆ·å·²æ¿€æ´»

### 6.3 ç”¨æˆ·ç¦ç”¨æ“ä½œè¯¦è§£

**ğŸš« å®‰å…¨çš„ç”¨æˆ·ç¦ç”¨æµç¨‹**

```bash
# ç¦ç”¨ç‰¹å®šç”¨æˆ·
sudo smbpasswd -d suspicious_user

# ç¦ç”¨ç”¨æˆ·å‰çš„å®‰å…¨æ£€æŸ¥
#!/bin/bash
# disable_user.sh

USERNAME=$1

if [ -z "$USERNAME" ]; then
    echo "ç”¨æ³•: $0 <username>"
    exit 1
fi

echo "å‡†å¤‡ç¦ç”¨ç”¨æˆ·: $USERNAME"

# æ£€æŸ¥ç”¨æˆ·å½“å‰è¿æ¥
echo "æ£€æŸ¥ç”¨æˆ·å½“å‰è¿æ¥..."
sudo smbstatus | grep "$USERNAME"

# å¼ºåˆ¶æ–­å¼€ç”¨æˆ·è¿æ¥ï¼ˆå¯é€‰ï¼‰
read -p "æ˜¯å¦å¼ºåˆ¶æ–­å¼€ç”¨æˆ·è¿æ¥? (y/n): " choice
if [ "$choice" = "y" ]; then
    sudo smbcontrol smbd close-share-by-user $USERNAME
fi

# ç¦ç”¨ç”¨æˆ·
sudo smbpasswd -d $USERNAME

echo "ç”¨æˆ· $USERNAME å·²è¢«ç¦ç”¨"

# è®°å½•æ“ä½œæ—¥å¿—
echo "$(date): ç”¨æˆ· $USERNAME è¢« $(whoami) ç¦ç”¨" >> /var/log/samba_user_management.log
```

### 6.4 æ‰¹é‡ç”¨æˆ·çŠ¶æ€ç®¡ç†

**ğŸ“Š æ‰¹é‡ç®¡ç†è‡ªåŠ¨åŒ–è„šæœ¬**

```bash
#!/bin/bash
# bulk_user_management.sh

ACTION=$1  # enable, disable, status
USER_LIST_FILE=$2

if [ -z "$ACTION" ] || [ -z "$USER_LIST_FILE" ]; then
    echo "ç”¨æ³•: $0 <enable|disable|status> <user_list_file>"
    exit 1
fi

case $ACTION in
    "enable")
        while read username; do
            sudo smbpasswd -e "$username" 2>/dev/null
            if [ $? -eq 0 ]; then
                echo "âœ… $username å¯ç”¨æˆåŠŸ"
            else
                echo "âŒ $username å¯ç”¨å¤±è´¥"
            fi
        done < "$USER_LIST_FILE"
        ;;
        
    "disable")
        while read username; do
            sudo smbpasswd -d "$username" 2>/dev/null
            if [ $? -eq 0 ]; then
                echo "ğŸš« $username ç¦ç”¨æˆåŠŸ"
            else
                echo "âŒ $username ç¦ç”¨å¤±è´¥"
            fi
        done < "$USER_LIST_FILE"
        ;;
        
    "status")
        echo "ç”¨æˆ·çŠ¶æ€æŠ¥å‘Šï¼š"
        echo "==============="
        while read username; do
            status=$(sudo pdbedit -L -v "$username" 2>/dev/null | grep "Account Flags" | grep -o '\[.*\]')
            echo "$username: $status"
        done < "$USER_LIST_FILE"
        ;;
esac
```

---

## 7. ğŸ‘¤ guestç”¨æˆ·è®¿é—®é…ç½®


### 7.1 Guestç”¨æˆ·è®¿é—®åŸç†

ğŸ¯ **Guestç”¨æˆ·å°±åƒ"è®¿å®¢é€šè¡Œè¯"**

```
Guestè®¿é—®æ¦‚å¿µï¼š
- æ— éœ€ç”¨æˆ·åå¯†ç å³å¯è®¿é—®
- é€šå¸¸æƒé™å—é™ï¼ˆåªè¯»è®¿é—®ï¼‰
- é€‚åˆå…¬å…±èµ„æºåˆ†äº«
- å­˜åœ¨ä¸€å®šå®‰å…¨é£é™©

å®é™…åº”ç”¨åœºæ™¯ï¼š
- å…¬å¸å†…éƒ¨å…¬å‘Šæ¿
- è½¯ä»¶ä¸‹è½½åŒºåŸŸ  
- ä¸´æ—¶æ–‡ä»¶äº¤æ¢
- å®¢æˆ·èµ„æ–™æŸ¥çœ‹
```

### 7.2 å¯ç”¨Guestè®¿é—®é…ç½®

**ğŸ”“ é…ç½®åŒ¿åè®¿é—®å…±äº«**

åœ¨ `/etc/samba/smb.conf` ä¸­é…ç½®ï¼š
```ini
[global]
# å¯ç”¨guestç”¨æˆ·æ˜ å°„
map to guest = Bad User
# å½“ç”¨æˆ·ä¸å­˜åœ¨æ—¶è‡ªåŠ¨æ˜ å°„ä¸ºguest

# æŒ‡å®šguestç”¨æˆ·å¯¹åº”çš„ç³»ç»Ÿç”¨æˆ·
guest account = nobody

# å…è®¸guestè®¿é—®
security = user

[public-share]
path = /srv/samba/public
# å…è®¸guestè®¿é—®
guest ok = yes
# æˆ–è€…ä½¿ç”¨ public = yes

# åªè¯»è®¿é—®ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
read only = yes

# æµè§ˆæƒé™
browseable = yes

# å…è®¸guestå†™å…¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
# writable = yes
# guest only = yes  # å¼ºåˆ¶æ‰€æœ‰è®¿é—®éƒ½ä½œä¸ºguest

comment = å…¬å…±åªè¯»å…±äº«åŒºåŸŸ
```

### 7.3 Guestç”¨æˆ·æƒé™æ§åˆ¶

**ğŸ›¡ï¸ å®‰å…¨çš„Guestè®¿é—®ç­–ç•¥**

**åˆ›å»ºä¸“ç”¨çš„publicç›®å½•**ï¼š
```bash
# åˆ›å»ºå…¬å…±å…±äº«ç›®å½•
sudo mkdir -p /srv/samba/public

# è®¾ç½®å®‰å…¨çš„æƒé™
sudo chown root:nogroup /srv/samba/public
sudo chmod 755 /srv/samba/public

# åœ¨å…¬å…±ç›®å½•ä¸­æ”¾ç½®åªè¯»æ–‡ä»¶
sudo cp /path/to/public/files/* /srv/samba/public/
sudo chmod 644 /srv/samba/public/*
```

**å¤šå±‚æ¬¡Guestæƒé™é…ç½®**ï¼š
```ini
# å®Œå…¨å…¬å¼€çš„åªè¯»åŒºåŸŸ
[announcements]
path = /srv/samba/announcements  
guest ok = yes
read only = yes
browseable = yes
comment = å…¬å¸å…¬å‘ŠåŒºåŸŸ

# æœ‰é™åˆ¶çš„guestå†™å…¥åŒºåŸŸ
[temp-upload]
path = /srv/samba/temp
guest ok = yes
writable = yes
browseable = yes
# é™åˆ¶æ–‡ä»¶ç±»å‹
veto files = /*.exe/*.bat/*.com/*.scr/
# è‡ªåŠ¨åˆ é™¤æœºåˆ¶
delete veto files = yes
comment = ä¸´æ—¶æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ
```

### 7.4 Guestè®¿é—®å®‰å…¨åŠ å›º

**ğŸ”’ é™ä½Guestè®¿é—®é£é™©**

**è®¿é—®æ§åˆ¶åˆ—è¡¨**ï¼š
```ini
[public-restricted]
path = /srv/samba/public
guest ok = yes
read only = yes

# IPåœ°å€è®¿é—®æ§åˆ¶
hosts allow = 192.168.1.0/24 127.0.0.1
hosts deny = ALL

# æ—¶é—´è®¿é—®æ§åˆ¶ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰
# åªå…è®¸å·¥ä½œæ—¶é—´è®¿é—®
```

**æ—¥å¿—è®°å½•å’Œç›‘æ§**ï¼š
```ini
[global]
# è¯¦ç»†çš„æ—¥å¿—è®°å½•
log level = 2
log file = /var/log/samba/samba.log
max log size = 1000

# å®¡è®¡æ—¥å¿—
full_audit:priority = notice
full_audit:facility = local5
vfs objects = full_audit
```

**Guestè®¿é—®ç›‘æ§è„šæœ¬**ï¼š
```bash
#!/bin/bash
# monitor_guest_access.sh

LOG_FILE="/var/log/samba/samba.log"
REPORT_FILE="/tmp/guest_access_report.txt"

echo "Guestç”¨æˆ·è®¿é—®ç»Ÿè®¡æŠ¥å‘Š" > $REPORT_FILE
echo "ç”Ÿæˆæ—¶é—´: $(date)" >> $REPORT_FILE
echo "=========================" >> $REPORT_FILE

# ç»Ÿè®¡guestè®¿é—®æ¬¡æ•°
guest_connections=$(grep -c "nobody.*connect" $LOG_FILE)
echo "Guestè¿æ¥æ€»æ•°: $guest_connections" >> $REPORT_FILE

# ç»Ÿè®¡è®¿é—®çš„IPåœ°å€
echo "è®¿é—®IPåœ°å€ç»Ÿè®¡:" >> $REPORT_FILE
grep "nobody.*connect" $LOG_FILE | grep -o "([0-9.]*)" | sort | uniq -c >> $REPORT_FILE

# æ£€æŸ¥å¯ç–‘æ´»åŠ¨
suspicious_count=$(grep -c "nobody.*DENIED" $LOG_FILE)
if [ $suspicious_count -gt 0 ]; then
    echo "âš ï¸  å‘ç° $suspicious_count æ¬¡å¯ç–‘è®¿é—®å°è¯•" >> $REPORT_FILE
fi

# å‘é€æŠ¥å‘Šï¼ˆå¦‚æœé…ç½®äº†é‚®ä»¶ï¼‰
# mail -s "Guestè®¿é—®æŠ¥å‘Š" admin@company.com < $REPORT_FILE
```

---

## 8. ğŸ‘¥ ç”¨æˆ·ç»„æƒé™æ˜ å°„


### 8.1 ç”¨æˆ·ç»„æƒé™æ˜ å°„åŸç†

ğŸ¯ **ç»„æƒé™æ˜ å°„å°±åƒ"éƒ¨é—¨æƒé™ç®¡ç†"**

```
æƒé™æ˜ å°„æ¦‚å¿µï¼š
Linuxç”¨æˆ·ç»„ â†â†’ Sambaè®¿é—®æƒé™
éƒ¨é—¨åˆ’åˆ†   â†â†’ èµ„æºè®¿é—®æ§åˆ¶

å®é™…åœºæ™¯ï¼š
è´¢åŠ¡éƒ¨ç»„ â†’ åªèƒ½è®¿é—®è´¢åŠ¡æ–‡ä»¶å¤¹
æŠ€æœ¯éƒ¨ç»„ â†’ å¯ä»¥è®¿é—®å¼€å‘èµ„æ–™
ç®¡ç†å±‚ç»„ â†’ æ‹¥æœ‰æ‰€æœ‰ç›®å½•æƒé™
```

### 8.2 åˆ›å»ºå’Œç®¡ç†ç”¨æˆ·ç»„

**ğŸ‘¥ ç”¨æˆ·ç»„çš„åˆ›å»ºä¸é…ç½®**

```bash
# åˆ›å»ºä¸šåŠ¡ç›¸å…³çš„ç”¨æˆ·ç»„
sudo groupadd finance      # è´¢åŠ¡éƒ¨
sudo groupadd development  # å¼€å‘éƒ¨  
sudo groupadd marketing    # å¸‚åœºéƒ¨
sudo groupadd management   # ç®¡ç†å±‚

# å°†ç”¨æˆ·åŠ å…¥å¯¹åº”ç»„
sudo usermod -a -G finance john
sudo usermod -a -G development jane  
sudo usermod -a -G marketing mike
sudo usermod -a -G management admin

# æŸ¥çœ‹ç”¨æˆ·æ‰€å±ç»„
groups john
id john
```

### 8.3 ç»„æƒé™å…±äº«é…ç½®

**ğŸ—‚ï¸ åŸºäºç»„çš„å…±äº«æƒé™è®¾ç½®**

```ini
# è´¢åŠ¡éƒ¨é—¨å…±äº«
[finance]
path = /srv/samba/finance
valid users = @finance
read only = no
browseable = yes
create mask = 0660
directory mask = 0770
comment = è´¢åŠ¡éƒ¨ä¸“ç”¨ç›®å½•

# å¼€å‘éƒ¨é—¨å…±äº«
[development] 
path = /srv/samba/dev
valid users = @development
read only = no
browseable = yes
create mask = 0664
directory mask = 0775
comment = å¼€å‘éƒ¨èµ„æ–™å…±äº«

# ç®¡ç†å±‚å…±äº«ï¼ˆå¤šç»„è®¿é—®ï¼‰
[management]
path = /srv/samba/mgmt
valid users = @management @finance @development
read only = no
browseable = yes
admin users = @management
comment = ç®¡ç†å±‚å’Œéƒ¨é—¨ä¸»ç®¡å…±äº«
```

**æƒé™å‚æ•°è¯¦è§£**ï¼š
- **valid users = @groupname**ï¼šåªå…è®¸æŒ‡å®šç»„çš„ç”¨æˆ·è®¿é—®
- **admin users = @groupname**ï¼šç»„å†…ç”¨æˆ·æ‹¥æœ‰ç®¡ç†å‘˜æƒé™
- **create mask = 0660**ï¼šæ–°æ–‡ä»¶æƒé™æ©ç 
- **directory mask = 0770**ï¼šæ–°ç›®å½•æƒé™æ©ç 

### 8.4 å¤æ‚æƒé™æ˜ å°„ç­–ç•¥

**ğŸ›ï¸ é«˜çº§æƒé™æ§åˆ¶é…ç½®**

```ini
# å¤šå±‚æƒé™æ§åˆ¶ç¤ºä¾‹
[project-files]
path = /srv/samba/projects
# è¯»å–æƒé™ï¼šæ‰€æœ‰å‘˜å·¥
valid users = @employees

# å†™å…¥æƒé™ï¼šåªæœ‰å¼€å‘å’Œç®¡ç†
write list = @development @management

# ç®¡ç†æƒé™ï¼šåªæœ‰é¡¹ç›®ç»ç†
admin users = @project-managers

# æŒ‰æ–‡ä»¶ç±»å‹æ§åˆ¶æƒé™
# ç¦æ­¢ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶
veto files = /*.exe/*.bat/*.com/*.scr/

# éšè—ç³»ç»Ÿæ–‡ä»¶
hide dot files = yes

comment = é¡¹ç›®æ–‡ä»¶åä½œåŒºåŸŸ
```

**åŠ¨æ€æƒé™ç®¡ç†è„šæœ¬**ï¼š
```bash
#!/bin/bash
# manage_group_permissions.sh

ACTION=$1
GROUP=$2
SHARE=$3

case $ACTION in
    "add_group_to_share")
        # åœ¨å…±äº«é…ç½®ä¸­æ·»åŠ ç»„æƒé™
        sudo sed -i "/\[${SHARE}\]/,/^\[/s/valid users = /valid users = @${GROUP} /" /etc/samba/smb.conf
        sudo systemctl reload smbd
        echo "ç»„ $GROUP å·²æ·»åŠ åˆ°å…±äº« $SHARE"
        ;;
        
    "remove_group_from_share") 
        # ä»å…±äº«é…ç½®ä¸­ç§»é™¤ç»„æƒé™
        sudo sed -i "/\[${SHARE}\]/,/^\[/s/@${GROUP} //g" /etc/samba/smb.conf
        sudo systemctl reload smbd
        echo "ç»„ $GROUP å·²ä»å…±äº« $SHARE ä¸­ç§»é™¤"
        ;;
        
    "list_group_permissions")
        echo "ç»„æƒé™æ¦‚è§ˆï¼š"
        sudo pdbedit -L | while read user; do
            username=$(echo $user | cut -d: -f1)
            groups=$(id -nG $username 2>/dev/null)
            echo "$username: $groups"
        done
        ;;
esac
```

---

## 9. ğŸ” å¯†ç ç­–ç•¥é…ç½®


### 9.1 ä¼ä¸šçº§å¯†ç ç­–ç•¥åŸåˆ™

ğŸ¯ **å¯†ç ç­–ç•¥å°±åƒ"ä¼ä¸šå®‰å…¨é—¨ç¦è§„åˆ™"**

```
å¯†ç å®‰å…¨åŸåˆ™ï¼š
å¤æ‚åº¦ï¼šè¶³å¤Ÿå¤æ‚éš¾ä»¥ç ´è§£
æ—¶æ•ˆæ€§ï¼šå®šæœŸæ›´æ¢é˜²æ­¢é•¿æœŸä½¿ç”¨
å”¯ä¸€æ€§ï¼šé¿å…é‡å¤ä½¿ç”¨å†å²å¯†ç 
ç®¡ç†æ€§ï¼šä¾¿äºç®¡ç†å‘˜ç»Ÿä¸€æ§åˆ¶

å¸¸è§å¯†ç ç­–ç•¥ï¼š
æœ€å°é•¿åº¦ï¼š8-12ä¸ªå­—ç¬¦
å¤æ‚åº¦è¦æ±‚ï¼šå¤§å°å†™+æ•°å­—+ç‰¹æ®Šå­—ç¬¦
æ›´æ¢å‘¨æœŸï¼š30-90å¤©
å†å²è®°å½•ï¼šç¦æ­¢é‡å¤ä½¿ç”¨æœ€è¿‘5ä¸ªå¯†ç 
```

### 9.2 Sambaå¯†ç å¤æ‚åº¦é…ç½®

**ğŸ›¡ï¸ å¼ºå¯†ç ç­–ç•¥å®æ–½**

åœ¨ `/etc/samba/smb.conf` ä¸­é…ç½®ï¼š
```ini
[global]
# å¯†ç æœ€å°é•¿åº¦
min password length = 8

# å¯†ç å¤æ‚åº¦æ£€æŸ¥è„šæœ¬
check password script = /etc/samba/scripts/password_policy.sh %u %n

# å¯†ç å†å²è®°å½•ï¼ˆé˜²æ­¢é‡ç”¨ï¼‰
password history = 5

# å¯†ç æ›´æ¢é—´éš”ï¼ˆå¤©ï¼‰
max password age = 90
min password age = 1

# è´¦æˆ·é”å®šç­–ç•¥
lockout duration = 1800    # é”å®š30åˆ†é’Ÿ
lockout threshold = 3      # 3æ¬¡å¤±è´¥åé”å®š
```

**å¯†ç ç­–ç•¥æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# /etc/samba/scripts/password_policy.sh

USERNAME=$1
PASSWORD=$2
LOG_FILE="/var/log/samba_password_policy.log"

# æ—¥å¿—è®°å½•å‡½æ•°
log_message() {
    echo "$(date): $USERNAME - $1" >> $LOG_FILE
}

# æ£€æŸ¥å¯†ç é•¿åº¦
if [ ${#PASSWORD} -lt 8 ]; then
    log_message "å¯†ç é•¿åº¦ä¸è¶³"
    echo "å¯†ç é•¿åº¦è‡³å°‘éœ€è¦8ä¸ªå­—ç¬¦"
    exit 1
fi

# æ£€æŸ¥å­—ç¬¦ç±»å‹å¤šæ ·æ€§
char_types=0

# æ£€æŸ¥å°å†™å­—æ¯
if [[ $PASSWORD =~ [a-z] ]]; then
    char_types=$((char_types + 1))
fi

# æ£€æŸ¥å¤§å†™å­—æ¯  
if [[ $PASSWORD =~ [A-Z] ]]; then
    char_types=$((char_types + 1))
fi

# æ£€æŸ¥æ•°å­—
if [[ $PASSWORD =~ [0-9] ]]; then
    char_types=$((char_types + 1))
fi

# æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦
if [[ $PASSWORD =~ [^a-zA-Z0-9] ]]; then
    char_types=$((char_types + 1))
fi

# è‡³å°‘éœ€è¦3ç§å­—ç¬¦ç±»å‹
if [ $char_types -lt 3 ]; then
    log_message "å¯†ç å¤æ‚åº¦ä¸å¤Ÿ"
    echo "å¯†ç å¿…é¡»åŒ…å«è‡³å°‘3ç§ç±»å‹çš„å­—ç¬¦ï¼ˆå¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰"
    exit 1
fi

# æ£€æŸ¥å¸¸è§å¼±å¯†ç 
WEAK_PASSWORDS=("password" "123456" "qwerty" "admin" "root" "user")
for weak in "${WEAK_PASSWORDS[@]}"; do
    if [[ "${PASSWORD,,}" == *"${weak}"* ]]; then
        log_message "ä½¿ç”¨äº†å¸¸è§å¼±å¯†ç "
        echo "å¯†ç ä¸èƒ½åŒ…å«å¸¸è§å¼±å¯†ç ç»„åˆ"
        exit 1
    fi
done

# æ£€æŸ¥ç”¨æˆ·åç›¸å…³æ€§
if [[ "${PASSWORD,,}" == *"${USERNAME,,}"* ]]; then
    log_message "å¯†ç åŒ…å«ç”¨æˆ·å"
    echo "å¯†ç ä¸èƒ½åŒ…å«ç”¨æˆ·å"
    exit 1
fi

log_message "å¯†ç ç­–ç•¥æ£€æŸ¥é€šè¿‡"
exit 0
```

### 9.3 å¯†ç è¿‡æœŸå’Œé€šçŸ¥æœºåˆ¶

**â° è‡ªåŠ¨åŒ–å¯†ç ç®¡ç†**

**å¯†ç è¿‡æœŸæ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# password_expiry_check.sh

WARN_DAYS=7  # æå‰7å¤©è­¦å‘Š
REPORT_FILE="/tmp/password_expiry_report.txt"

echo "å¯†ç è¿‡æœŸæ£€æŸ¥æŠ¥å‘Š - $(date)" > $REPORT_FILE
echo "================================" >> $REPORT_FILE

# æ£€æŸ¥æ‰€æœ‰Sambaç”¨æˆ·çš„å¯†ç çŠ¶æ€
sudo pdbedit -L | while IFS=: read username uid; do
    # è·å–ç”¨æˆ·å¯†ç ä¿¡æ¯
    password_info=$(sudo chage -l $username 2>/dev/null)
    
    if [ $? -eq 0 ]; then
        # è§£æå¯†ç è¿‡æœŸæ—¥æœŸ
        expire_date=$(echo "$password_info" | grep "Password expires" | cut -d: -f2- | xargs)
        
        if [ "$expire_date" != "never" ]; then
            # è®¡ç®—è·ç¦»è¿‡æœŸçš„å¤©æ•°
            expire_timestamp=$(date -d "$expire_date" +%s 2>/dev/null)
            current_timestamp=$(date +%s)
            days_until_expire=$(( (expire_timestamp - current_timestamp) / 86400 ))
            
            if [ $days_until_expire -le $WARN_DAYS ] && [ $days_until_expire -ge 0 ]; then
                echo "âš ï¸  ç”¨æˆ· $username å¯†ç å°†åœ¨ $days_until_expire å¤©åè¿‡æœŸ" >> $REPORT_FILE
                
                # å‘é€é€šçŸ¥ç»™ç”¨æˆ·ï¼ˆå¦‚æœæœ‰é‚®ä»¶ç³»ç»Ÿï¼‰
                # echo "æ‚¨çš„å¯†ç å°†åœ¨ $days_until_expire å¤©åè¿‡æœŸï¼Œè¯·åŠæ—¶æ›´æ–°" | \
                # mail -s "å¯†ç è¿‡æœŸæé†’" $username@company.com
            elif [ $days_until_expire -lt 0 ]; then
                echo "ğŸš¨ ç”¨æˆ· $username å¯†ç å·²è¿‡æœŸ $((-days_until_expire)) å¤©" >> $REPORT_FILE
            fi
        fi
    fi
done

# å¦‚æœæœ‰è¿‡æœŸæˆ–å³å°†è¿‡æœŸçš„å¯†ç ï¼Œå‘é€æŠ¥å‘Š
if grep -q "âš ï¸\|ğŸš¨" $REPORT_FILE; then
    # mail -s "å¯†ç è¿‡æœŸæŠ¥å‘Š" admin@company.com < $REPORT_FILE
    echo "å‘ç°å¯†ç è¿‡æœŸé—®é¢˜ï¼Œè¯·æ£€æŸ¥æŠ¥å‘Šï¼š$REPORT_FILE"
fi
```

### 9.4 å¯†ç ç­–ç•¥å®¡è®¡å’Œç›‘æ§

**ğŸ“Š å¯†ç å®‰å…¨æ€§ç›‘æ§**

```bash
#!/bin/bash
# password_audit.sh

AUDIT_REPORT="/var/log/samba_password_audit.log"

echo "=== Sambaå¯†ç ç­–ç•¥å®¡è®¡ $(date) ===" >> $AUDIT_REPORT

# ç»Ÿè®¡å¯†ç ç­–ç•¥è¿è§„æƒ…å†µ
echo "å¯†ç ç­–ç•¥è¿è§„ç»Ÿè®¡ï¼š" >> $AUDIT_REPORT

# æ£€æŸ¥å¯†ç é•¿åº¦ä¸è¶³çš„ç”¨æˆ·æ•°é‡
weak_password_count=0
locked_account_count=0
total_users=0

sudo pdbedit -L | while IFS=: read username uid; do
    total_users=$((total_users + 1))
    
    # æ£€æŸ¥è´¦æˆ·é”å®šçŠ¶æ€
    account_flags=$(sudo pdbedit -u $username -v | grep "Account Flags")
    if [[ $account_flags == *"L"* ]]; then
        locked_account_count=$((locked_account_count + 1))
        echo "ğŸ”’ è´¦æˆ· $username å·²è¢«é”å®š" >> $AUDIT_REPORT
    fi
    
    # æ£€æŸ¥æœ€è¿‘çš„ç™»å½•æ—¶é—´
    last_login=$(sudo pdbedit -u $username -v | grep "Logon time" | cut -d: -f2-)
    echo "ç”¨æˆ· $username æœ€åç™»å½•: $last_login" >> $AUDIT_REPORT
done

echo "å®¡è®¡æ€»ç»“ï¼š" >> $AUDIT_REPORT
echo "æ€»ç”¨æˆ·æ•°ï¼š$total_users" >> $AUDIT_REPORT  
echo "é”å®šè´¦æˆ·æ•°ï¼š$locked_account_count" >> $AUDIT_REPORT
echo "==============================" >> $AUDIT_REPORT

# æ¸…ç†30å¤©å‰çš„å®¡è®¡æ—¥å¿—
find /var/log -name "*password_audit*" -mtime +30 -delete
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åŒé‡èº«ä»½ï¼šSambaç”¨æˆ·åŸºäºLinuxç”¨æˆ·ï¼Œä½†æœ‰ç‹¬ç«‹çš„å¯†ç ç³»ç»Ÿ
ğŸ”¸ ç”¨æˆ·ç®¡ç†å·¥å…·ï¼šsmbpasswdåŸºç¡€ç®¡ç†ï¼Œpdbedité«˜çº§ç®¡ç†
ğŸ”¸ ç”¨æˆ·çŠ¶æ€ï¼šå¯ç”¨ã€ç¦ç”¨ã€åˆ é™¤ä¸‰ç§çŠ¶æ€çš„çµæ´»æ§åˆ¶
ğŸ”¸ å¯†ç åŒæ­¥ï¼šUnixå¯†ç åŒæ­¥å’ŒPAMé›†æˆå®ç°ç»Ÿä¸€è®¤è¯
ğŸ”¸ Guestè®¿é—®ï¼šåŒ¿åè®¿é—®çš„å®‰å…¨é…ç½®å’Œæƒé™æ§åˆ¶
ğŸ”¸ ç»„æƒé™æ˜ å°„ï¼šåŸºäºLinuxç”¨æˆ·ç»„çš„Sambaå…±äº«æƒé™ç®¡ç†
ğŸ”¸ å¯†ç ç­–ç•¥ï¼šä¼ä¸šçº§çš„å¯†ç å¤æ‚åº¦å’Œå®‰å…¨ç­–ç•¥å®æ–½
ğŸ”¸ å®¡è®¡ç›‘æ§ï¼šç”¨æˆ·æ´»åŠ¨å’Œå¯†ç å®‰å…¨çš„æŒç»­ç›‘æ§
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Sambaç”¨æˆ·ç®¡ç†çš„æ ¸å¿ƒé€»è¾‘**
```
åŸºç¡€åŸåˆ™ï¼š
- å…ˆæœ‰Linuxç”¨æˆ·ï¼Œå†æœ‰Sambaç”¨æˆ·
- ä¸¤å¥—å¯†ç ç³»ç»Ÿå¯ä»¥ç‹¬ç«‹ä¹Ÿå¯ä»¥åŒæ­¥
- æƒé™ç»§æ‰¿Linuxæ–‡ä»¶ç³»ç»Ÿæƒé™

ç®¡ç†ç­–ç•¥ï¼š
- ä½¿ç”¨ç»„æƒé™ç®€åŒ–ç”¨æˆ·ç®¡ç†
- å¯ç”¨/ç¦ç”¨æ¯”åˆ é™¤æ›´å®‰å…¨
- å®šæœŸå®¡è®¡ç”¨æˆ·çŠ¶æ€å’Œæƒé™

å®‰å…¨è€ƒè™‘ï¼š
- å¼ºå¯†ç ç­–ç•¥é™ä½ç ´è§£é£é™©
- Guestè®¿é—®éœ€è¦ä¸¥æ ¼æƒé™æ§åˆ¶
- å¯†ç åŒæ­¥æå‡ç”¨æˆ·ä½“éªŒä½†éœ€è€ƒè™‘å®‰å…¨æ€§
```

**ğŸ”¹ ç”¨æˆ·ç®¡ç†å·¥å…·çš„é€‰æ‹©**
```
smbpasswdé€‚ç”¨åœºæ™¯ï¼š
- åŸºç¡€ç”¨æˆ·å¢åˆ æ”¹æ“ä½œ
- è„šæœ¬åŒ–çš„æ‰¹é‡ç”¨æˆ·ç®¡ç†
- ç®€å•çš„ç”¨æˆ·çŠ¶æ€æ§åˆ¶

pdbedité€‚ç”¨åœºæ™¯ï¼š
- ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ç®¡ç†
- ç”¨æˆ·æ•°æ®åº“å¤‡ä»½æ¢å¤
- å¤æ‚çš„ç”¨æˆ·å±æ€§é…ç½®

æœ€ä½³å®è·µï¼š
- æ—¥å¸¸ç®¡ç†ä½¿ç”¨smbpasswd
- é«˜çº§ç®¡ç†ä½¿ç”¨pdbedit  
- é‡è¦æ“ä½œå‰å¤‡ä»½ç”¨æˆ·æ•°æ®åº“
```

**ğŸ”¹ æƒé™æ§åˆ¶çš„å±‚æ¬¡åŒ–è®¾è®¡**
```
ç”¨æˆ·çº§æƒé™ï¼š
- ä¸ªäººä¸“å±ç›®å½•çš„å®Œå…¨æ§åˆ¶
- ç‰¹å®šå…±äº«çš„è®¿é—®æƒé™
- æ•æ„Ÿæ•°æ®çš„ä¸ªäººæˆæƒ

ç»„çº§æƒé™ï¼š
- éƒ¨é—¨å…±äº«èµ„æºçš„åä½œæƒé™
- é¡¹ç›®å›¢é˜Ÿçš„ä¸´æ—¶æƒé™
- è§’è‰²æƒé™çš„ç»§æ‰¿å…³ç³»

å…¨å±€æƒé™ï¼š
- Guestç”¨æˆ·çš„é™åˆ¶æ€§è®¿é—®
- ç³»ç»Ÿç®¡ç†å‘˜çš„ç‰¹æƒæ§åˆ¶
- å®‰å…¨ç­–ç•¥çš„ç»Ÿä¸€å®æ–½
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¼ä¸šåº”ç”¨åœºæ™¯**
- **ä¸­å°ä¼ä¸š**ï¼šéƒ¨é—¨æ–‡ä»¶å…±äº«å’Œåä½œå¹³å°
- **æ•™è‚²æœºæ„**ï¼šå­¦ç”Ÿä½œä¸šæäº¤å’Œèµ„æ–™åˆ†å‘ç³»ç»Ÿ
- **åˆ›æ„å›¢é˜Ÿ**ï¼šå¤§å‹æ–‡ä»¶çš„é›†ä¸­å­˜å‚¨å’Œç‰ˆæœ¬ç®¡ç†
- **åˆ†æ”¯æœºæ„**ï¼šæ€»éƒ¨ä¸åˆ†æ”¯æœºæ„çš„æ–‡ä»¶åŒæ­¥å…±äº«

**ğŸ”§ è¿ç»´æœ€ä½³å®è·µ**
- **æ ‡å‡†åŒ–æµç¨‹**ï¼šå»ºç«‹ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†æµç¨‹
- **è‡ªåŠ¨åŒ–å·¥å…·**ï¼šå¼€å‘æ‰¹é‡ç”¨æˆ·ç®¡ç†å’Œç›‘æ§è„šæœ¬
- **å®‰å…¨ç­–ç•¥**ï¼šå®æ–½å¼ºå¯†ç ç­–ç•¥å’Œå®šæœŸå®¡è®¡
- **å¤‡ä»½æ¢å¤**ï¼šå®šæœŸå¤‡ä»½ç”¨æˆ·æ•°æ®åº“å’Œé…ç½®æ–‡ä»¶

**ğŸ“ˆ ç®¡ç†ä¼˜åŒ–å»ºè®®**
- **æƒé™æœ€å°åŒ–**ï¼šç”¨æˆ·åªè·å¾—å¿…éœ€çš„æœ€å°æƒé™
- **å®šæœŸæ¸…ç†**ï¼šæ¸…ç†æ— æ•ˆè´¦æˆ·å’Œè¿‡æœŸæƒé™
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹ç”¨æˆ·æ´»åŠ¨ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦
- **æ–‡æ¡£ç®¡ç†**ï¼šç»´æŠ¤å®Œæ•´çš„ç”¨æˆ·ç®¡ç†æ“ä½œæ‰‹å†Œ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åŒé‡èº«ä»½å·§ç®¡ç†ï¼ŒLinuxåŸºç¡€Sambaè®¤è¯
- ç»„æƒé™æ˜ å°„éƒ¨é—¨åŒ–ï¼ŒGuestè®¿é—®æ§åˆ¶ä¸¥æ ¼åŒ–
- å¯†ç ç­–ç•¥ä¿å®‰å…¨ï¼Œå¯ç”¨ç¦ç”¨çµæ´»æ¢
- å·¥å…·é€‰æ‹©çœ‹åœºæ™¯ï¼Œå®¡è®¡ç›‘æ§ä¸å¯ç¼º