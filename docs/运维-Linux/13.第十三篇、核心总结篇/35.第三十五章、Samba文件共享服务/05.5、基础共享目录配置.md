---
title: 5、基础共享目录配置
---
## 📚 目录

1. [Samba共享目录概述](#1-Samba共享目录概述)
2. [共享目录定义语法](#2-共享目录定义语法)
3. [基础配置参数详解](#3-基础配置参数详解)
4. [用户权限控制](#4-用户权限控制)
5. [文件权限管理](#5-文件权限管理)
6. [强制用户和组设置](#6-强制用户和组设置)
7. [实际配置示例](#7-实际配置示例)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌐 Samba共享目录概述


### 1.1 什么是Samba共享目录


**简单理解**：
Samba共享目录就像是在Linux服务器上开了一扇"窗户"，让Windows电脑可以像访问本地文件夹一样访问Linux上的文件夹。

```
现实比喻：
Linux服务器 = 一个房间
共享目录 = 房间的窗户
Windows电脑 = 外面的人

通过配置"窗户"的大小、谁能看、谁能碰，来控制文件访问
```

### 1.2 共享目录的作用


**核心功能**：
- **文件共享**：让不同系统之间可以共享文件
- **权限控制**：决定谁能访问、谁能修改
- **路径映射**：把Linux路径变成Windows能识别的网络驱动器

**实际应用场景**：
```
办公环境：
- 文档共享：Word、Excel文件共享给团队
- 项目资料：设计稿、代码文件集中存储
- 备份空间：个人文件备份到服务器

家庭环境：
- 媒体共享：电影、音乐、照片家庭共享
- 文件传输：手机、电脑之间传输大文件
- 打印共享：共享网络打印机
```

---

## 2. 📝 共享目录定义语法


### 2.1 基本语法结构


共享目录的定义就像给房间贴门牌号，告诉别人这个房间叫什么名字：

```ini
[共享名称]
    配置参数1 = 值1
    配置参数2 = 值2
    配置参数3 = 值3
```

**语法要点**：
- **方括号**：`[共享名称]` 就是这个共享在网络上的名字
- **缩进**：配置参数要用空格或tab缩进
- **赋值**：用等号连接参数名和值
- **注释**：用 `#` 或 `;` 开头的行是注释

### 2.2 共享名称的规则


```ini
# 正确示例
[公司文档]        # 中文名称（推荐用英文）
[company_docs]   # 英文名称（推荐）
[docs]           # 简短名称
[backup-2024]    # 带连字符

# 避免使用
[docs/backup]    # 包含斜杠可能有问题
[my docs]        # 空格可能在某些系统有问题
```

**命名建议**：
- **见名知意**：`project_files` 比 `pf` 更清楚
- **避免特殊字符**：只用字母、数字、下划线、连字符
- **长度适中**：不要太长，方便输入和记忆

---

## 3. 🔧 基础配置参数详解


### 3.1 path - 路径配置


**作用**：告诉Samba这个共享对应Linux系统上的哪个文件夹

```ini
[documents]
    path = /home/share/documents
```

**通俗解释**：
```
就像告诉快递员：
"文档共享" 这个门牌号对应的是 "/home/share/documents" 这个具体地址
```

**路径配置要点**：
- **绝对路径**：必须用完整路径，从根目录 `/` 开始
- **目录存在**：路径必须真实存在，否则无法访问
- **权限检查**：Samba用户要有这个目录的访问权限

### 3.2 browseable - 可浏览设置


**作用**：控制这个共享是否出现在"网络邻居"的列表中

```ini
[secret_docs]
    path = /home/secret
    browseable = no    # 隐藏，不在列表中显示

[public_docs]
    path = /home/public
    browseable = yes   # 显示在网络邻居中（默认值）
```

**实际效果**：
```
Windows网络邻居看到的：
📁 public_docs    ← browseable = yes 的共享
📁 company_files
📁 backup

secret_docs 不会出现在列表中，但知道名字的用户仍可直接访问
```

**使用场景**：
- **公开共享**：`browseable = yes` 让大家都看得到
- **隐藏共享**：`browseable = no` 只有知道名字的人才能访问

### 3.3 read only - 只读配置


**作用**：控制用户是否只能读取文件，不能修改

```ini
[readonly_docs]
    path = /home/docs
    read only = yes    # 只读，不能修改、删除、创建文件

[writable_docs] 
    path = /home/work
    read only = no     # 可读写（等同于 writable = yes）
```

**权限对照表**：

| 设置值 | 用户能做什么 | 实际效果 |
|--------|-------------|----------|
| `read only = yes` | 👁️ 查看、📁 浏览、📋 复制到本地 | **只读模式** |
| `read only = no` | 👁️ 查看、✏️ 修改、🗑️ 删除、➕ 创建 | **读写模式** |

---

## 4. 👥 用户权限控制


### 4.1 valid users - 访问用户限制


**作用**：指定哪些用户可以访问这个共享

```ini
[project_alpha]
    path = /home/projects/alpha
    valid users = tom jerry mike
    # 只有 tom、jerry、mike 这三个用户能访问

[department_hr]
    path = /home/hr
    valid users = @hr_group
    # @ 符号表示用户组，hr_group 组的所有用户都能访问

[mixed_access]
    path = /home/mixed  
    valid users = admin @developers guest
    # admin用户 + developers组的所有用户 + guest用户
```

**配置语法**：
- **单个用户**：直接写用户名，用空格分隔
- **用户组**：用 `@组名` 格式
- **混合配置**：用户名和组名可以混合使用

### 4.2 write list - 写权限用户


**作用**：在只读共享中，指定哪些用户可以写入

```ini
[mixed_permissions]
    path = /home/shared
    read only = yes          # 默认只读
    write list = tom @admin  # 但 tom 用户和 admin 组可以写入
```

**实际效果图**：
```
共享访问权限示意：
┌─────────────────┐
│  mixed_shared   │
├─────────────────┤
│ 普通用户: 只读   │ ← jerry, mike 等其他用户
│ tom: 可读写     │ ← 在 write list 中
│ admin组: 可读写  │ ← 在 write list 中  
└─────────────────┘
```

**使用场景**：
- **文档审核**：大部分人只能看，管理员能修改
- **代码仓库**：开发者能读，项目经理能写
- **资料分发**：员工只读，HR部门能更新

---

## 5. 📁 文件权限管理


### 5.1 create mask - 文件创建权限


**作用**：设置通过Samba创建的新文件的权限

```ini
[work_files]
    path = /home/work
    create mask = 0644
    # 新创建的文件权限：用户可读写，组和其他人只读
```

**权限数字含义**：
```
权限掩码解释：
0644 = 0 + 644
     ↑   ↑↑↑
     |   ||└── 其他人权限 (4 = 只读)
     |   |└─── 组权限 (4 = 只读)  
     |   └──── 用户权限 (6 = 读写)
     └────── 特殊权限位
```

**常用权限配置**：

| 权限值 | 含义 | 适用场景 |
|--------|------|----------|
| `0644` | 用户读写，其他只读 | **普通文档** |
| `0664` | 用户和组读写，其他只读 | **团队协作** |
| `0666` | 所有人读写 | **公共编辑** |
| `0600` | 只有用户读写 | **私人文件** |

### 5.2 directory mask - 目录创建权限


**作用**：设置通过Samba创建的新目录的权限

```ini
[project_space]
    path = /home/projects
    directory mask = 0755
    # 新目录：用户全权限，组和其他人可读可进入
```

**目录权限特点**：
```
目录权限含义：
读权限(r) = 可以列出目录内容
写权限(w) = 可以在目录中创建、删除文件
执行权限(x) = 可以进入目录

0755 权限分解：
用户(7) = 4+2+1 = 读+写+执行 (完全控制)
组(5) = 4+0+1 = 读+执行 (可浏览，不能创建文件)
其他(5) = 4+0+1 = 读+执行 (可浏览，不能创建文件)
```

---

## 6. 👤 强制用户和组设置


### 6.1 force user - 强制用户


**作用**：所有通过这个共享访问的操作，都以指定用户身份执行

```ini
[public_upload]
    path = /home/upload
    force user = nobody
    # 无论是谁访问，文件操作都以 nobody 用户身份进行
```

**使用场景示意**：
```
不使用 force user：
tom 上传文件 → 文件属主是 tom
jerry 上传文件 → 文件属主是 jerry
mike 无法删除 tom 的文件 (权限问题)

使用 force user = webuser：
tom 上传文件 → 文件属主是 webuser  
jerry 上传文件 → 文件属主是 webuser
mike 可以删除任何人的文件 (都是 webuser 的文件)
```

### 6.2 force group - 强制组


**作用**：强制所有文件操作使用指定的用户组

```ini
[team_work]
    path = /home/team
    force group = developers
    # 所有文件的组都是 developers
```

**组合使用示例**：
```ini
[shared_workspace]
    path = /home/workspace
    force user = projectuser
    force group = projectteam
    create mask = 0664
    directory mask = 0775
    # 统一身份，便于权限管理
```

---

## 7. 💼 实际配置示例


### 7.1 公司文档共享配置


```ini
[company_documents]
    comment = 公司文档共享区
    path = /home/samba/documents
    browseable = yes
    read only = no
    valid users = @office_staff
    create mask = 0664
    directory mask = 0775
    force group = office
```

**配置解读**：
- **共享名**：`company_documents` 在网络上显示的名称
- **路径**：实际文件存储在 `/home/samba/documents`
- **可见性**：在网络邻居中可见
- **权限**：`office_staff` 组成员可读写
- **文件权限**：新文件组内可读写，其他人只读
- **目录权限**：新目录组内可访问和创建文件
- **强制组**：统一使用 `office` 组

### 7.2 个人备份空间配置


```ini
[backup_space]  
    comment = 个人备份空间
    path = /home/backup/%u
    browseable = no
    read only = no
    valid users = %S
    create mask = 0600
    directory mask = 0700
    force user = %u
```

**特殊变量说明**：
- **%u**：当前用户名
- **%S**：当前共享名
- 这样每个用户访问时，路径自动变成 `/home/backup/用户名`

### 7.3 只读资料库配置


```ini
[reference_library]
    comment = 参考资料库
    path = /home/library
    browseable = yes  
    read only = yes
    write list = @librarians
    valid users = @all_staff
    create mask = 0644
    directory mask = 0755
```

**访问效果**：
```
用户访问情况：
📚 普通员工 (@all_staff)：
   - 可以浏览和下载资料
   - 不能修改、删除、上传

👨‍💼 图书管理员 (@librarians)：  
   - 可以浏览和下载
   - 可以上传新资料
   - 可以修改现有文件
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基础配置


```ini
🔸 基本结构：[共享名] + 缩进的配置参数
🔸 关键参数：
   • path = 实际Linux路径
   • browseable = 是否在网络中可见
   • read only = 是否只读
   • valid users = 允许访问的用户/组
🔸 权限控制：create mask + directory mask 控制新文件权限
🔸 强制身份：force user/group 统一文件归属
```

### 8.2 配置思路和最佳实践


**🔹 权限设计原则**：
```
1. 最小权限：只给必要的访问权限
2. 组管理：优先使用用户组而不是单个用户
3. 路径规划：合理规划共享目录结构
4. 权限继承：利用 force user/group 简化管理
```

**🔹 常见配置模式**：
```
公开只读：browseable=yes, read only=yes, valid users=@all
团队协作：valid users=@team, create mask=0664, force group=team  
个人空间：path=/home/%u, valid users=%S, browseable=no
管理共享：write list=@admin, read only=yes for others
```

**🔹 安全注意事项**：
- **用户验证**：确保 `valid users` 配置正确
- **路径权限**：Linux文件系统权限要和Samba配置匹配
- **敏感数据**：重要文件使用 `browseable=no` 隐藏
- **定期检查**：定期审查用户权限和访问日志

### 8.3 故障排查要点


**🔧 配置检查清单**：
- [ ] 共享名是否符合命名规范
- [ ] path路径是否存在且有权限
- [ ] valid users用户/组是否存在
- [ ] Linux文件权限是否匹配Samba配置
- [ ] 配置文件语法是否正确（缩进、等号）

**📝 测试验证**：
```bash
# 检查配置语法
testparm

# 查看共享列表  
smbclient -L localhost

# 测试用户访问
smbclient //localhost/共享名 -U 用户名
```

**核心记忆**：
- 共享配置就是开窗户，控制谁能看、谁能碰
- path是地址，valid users是门卫，权限是钥匙
- 用组管理比单个用户管理更高效
- 安全第一，最小权限原则不能忘