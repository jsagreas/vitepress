---
title: 6ã€SFTPäº¤äº’å¼æ–‡ä»¶ä¼ è¾“
---
## ğŸ“š ç›®å½•å¯¼èˆª

1. [SFTPåŸºç¡€æ¦‚å¿µç†è§£](#1-SFTPåŸºç¡€æ¦‚å¿µç†è§£)
2. [SFTPäº¤äº’å¼å‘½ä»¤ä½¿ç”¨](#2-SFTPäº¤äº’å¼å‘½ä»¤ä½¿ç”¨)
3. [è¿œç¨‹ç›®å½•æµè§ˆä¸æ“ä½œ](#3-è¿œç¨‹ç›®å½•æµè§ˆä¸æ“ä½œ)
4. [æ‰¹é‡æ–‡ä»¶ä¸Šä¼ ä¸‹è½½](#4-æ‰¹é‡æ–‡ä»¶ä¸Šä¼ ä¸‹è½½)
5. [SFTPè„šæœ¬åŒ–æ“ä½œ](#5-SFTPè„šæœ¬åŒ–æ“ä½œ)
6. [æ–‡ä»¶ä¼ è¾“æ–­ç‚¹ç»­ä¼ ](#6-æ–‡ä»¶ä¼ è¾“æ–­ç‚¹ç»­ä¼ )
7. [è¿œç¨‹æ–‡ä»¶æƒé™ç®¡ç†](#7-è¿œç¨‹æ–‡ä»¶æƒé™ç®¡ç†)
8. [SFTP chrootç›‘ç‹±é…ç½®](#8-SFTP-chrootç›‘ç‹±é…ç½®)
9. [SFTPæ—¥å¿—è®°å½•ä¸å®¡è®¡](#9-SFTPæ—¥å¿—è®°å½•ä¸å®¡è®¡)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ SFTPåŸºç¡€æ¦‚å¿µç†è§£


### 1.1 ä»€ä¹ˆæ˜¯SFTP


**ğŸ”¸ SFTPå®šä¹‰**
SFTPå…¨ç§°æ˜¯"Secure File Transfer Protocol"ï¼ˆå®‰å…¨æ–‡ä»¶ä¼ è¾“åè®®ï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºSSHåè®®çš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ã€‚

**ğŸŒ° ç”Ÿæ´»ç±»æ¯”ç†è§£**
```
æƒ³è±¡SFTPå°±åƒæ˜¯ä¸€ä¸ª"å¸¦å¯†ç é”çš„å¿«é€’ç®±"ï¼š
- ä¼ ç»ŸFTPï¼šå¿«é€’å‘˜ç›´æ¥æŠŠåŒ…è£¹æ‰”åœ¨ä½ é—¨å£ï¼ˆä¸å®‰å…¨ï¼‰
- SFTPï¼šå¿«é€’å‘˜æŠŠåŒ…è£¹æ”¾åœ¨å¸¦å¯†ç é”çš„ç®±å­é‡Œï¼ˆå®‰å…¨å¯é ï¼‰
```

**ğŸ”¸ SFTP vs FTPæ ¸å¿ƒåŒºåˆ«**

| ç‰¹æ€§å¯¹æ¯” | **FTP** | **SFTP** | **å®é™…æ„ä¹‰** |
|---------|---------|----------|-------------|
| ğŸ”’ **å®‰å…¨æ€§** | `æ˜æ–‡ä¼ è¾“` | `åŠ å¯†ä¼ è¾“` | `SFTPä¿æŠ¤æ•°æ®ä¸è¢«çªƒå¬` |
| ğŸ”Œ **ç«¯å£** | `21` | `22 (SSHç«¯å£)` | `SFTPå¤ç”¨SSHè¿æ¥` |
| ğŸ”‘ **è®¤è¯** | `ç”¨æˆ·åå¯†ç ` | `å¯†ç +å¯†é’¥` | `SFTPæ”¯æŒå¤šç§è®¤è¯æ–¹å¼` |
| ğŸŒ **é˜²ç«å¢™** | `éœ€è¦å¤šä¸ªç«¯å£` | `åªéœ€SSHç«¯å£` | `SFTPæ›´å®¹æ˜“é€šè¿‡é˜²ç«å¢™` |

### 1.2 SFTPå·¥ä½œåŸç†


**ğŸ“Š SFTPè¿æ¥å»ºç«‹è¿‡ç¨‹**
```
å®¢æˆ·ç«¯                     æœåŠ¡å™¨
  â”‚                         â”‚
  â”‚â”€[1]SSHè¿æ¥è¯·æ±‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚â—€â”€[2]æœåŠ¡å™¨å…¬é’¥â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â”€[3]å®¢æˆ·ç«¯è®¤è¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚â—€â”€[4]è®¤è¯æˆåŠŸç¡®è®¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â”€[5]SFTPå­ç³»ç»Ÿè¯·æ±‚â”€â”€â”€â”€â–¶â”‚
  â”‚â—€â”€[6]SFTPä¼šè¯å»ºç«‹â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                         â”‚
  â”‚ â•â•â• åŠ å¯†æ–‡ä»¶ä¼ è¾“ â•â•â•    â”‚
```

**ğŸ’¡ æ ¸å¿ƒç†è§£è¦ç‚¹**
- SFTPä¸æ˜¯ç‹¬ç«‹åè®®ï¼Œè€Œæ˜¯SSHçš„ä¸€ä¸ª**å­ç³»ç»Ÿ**
- æ‰€æœ‰æ•°æ®ä¼ è¾“éƒ½åœ¨**å•ä¸€åŠ å¯†é€šé“**ä¸­è¿›è¡Œ
- æ—¢å¯ä»¥ä¼ è¾“æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œ**æ–‡ä»¶ç®¡ç†æ“ä½œ**

---

## 2. ğŸ”§ SFTPäº¤äº’å¼å‘½ä»¤ä½¿ç”¨


### 2.1 å»ºç«‹SFTPè¿æ¥


**ğŸš€ åŸºæœ¬è¿æ¥æ–¹å¼**
```bash
# æ ‡å‡†è¿æ¥è¯­æ³•

sftp username@hostname

# æŒ‡å®šç«¯å£è¿æ¥

sftp -P 2022 username@hostname

# ä½¿ç”¨å¯†é’¥æ–‡ä»¶è¿æ¥

sftp -i ~/.ssh/private_key username@hostname
```

**ğŸ”¸ è¿æ¥å‚æ•°è¯¦è§£**

| å‚æ•°é€‰é¡¹ | **ä½œç”¨** | **ä½¿ç”¨åœºæ™¯** | **ç¤ºä¾‹** |
|----------|----------|-------------|----------|
| `-P` | `æŒ‡å®šSSHç«¯å£` | `éæ ‡å‡†22ç«¯å£` | `sftp -P 2022 user@host` |
| `-i` | `æŒ‡å®šå¯†é’¥æ–‡ä»¶` | `å¯†é’¥è®¤è¯` | `sftp -i ~/.ssh/key user@host` |
| `-v` | `è¯¦ç»†è¾“å‡ºæ¨¡å¼` | `è°ƒè¯•è¿æ¥é—®é¢˜` | `sftp -v user@host` |
| `-C` | `å¯ç”¨å‹ç¼©` | `æ…¢é€Ÿç½‘ç»œä¼ è¾“` | `sftp -C user@host` |

### 2.2 SFTPäº¤äº’ç¯å¢ƒ


**ğŸ”¸ è¿›å…¥SFTPåçš„æç¤ºç¬¦**
```bash
sftp> 
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> çœ‹åˆ°`sftp>`æç¤ºç¬¦å°±è¯´æ˜ä½ å·²ç»è¿›å…¥äº†SFTPäº¤äº’æ¨¡å¼ï¼Œæ­¤æ—¶ä½ å¯ä»¥ä½¿ç”¨SFTPä¸“ç”¨å‘½ä»¤æ¥æ“ä½œè¿œç¨‹æ–‡ä»¶ç³»ç»Ÿã€‚

**ğŸ”¸ åŸºç¡€å‘½ä»¤æ¦‚è§ˆ**

```bash
# æŸ¥çœ‹å¸®åŠ©

sftp> help

# é€€å‡ºSFTP

sftp> quit
# æˆ–è€…

sftp> exit
```

---

## 3. ğŸ“‚ è¿œç¨‹ç›®å½•æµè§ˆä¸æ“ä½œ


### 3.1 ç›®å½•æµè§ˆå‘½ä»¤


**ğŸ”¸ æŸ¥çœ‹è¿œç¨‹ç›®å½•å†…å®¹**
```bash
# åˆ—å‡ºå½“å‰è¿œç¨‹ç›®å½•æ–‡ä»¶

sftp> ls

# åˆ—å‡ºè¯¦ç»†ä¿¡æ¯ï¼ˆç±»ä¼¼ ls -lï¼‰

sftp> ls -l

# æŸ¥çœ‹æŒ‡å®šç›®å½•

sftp> ls /home/user/documents
```

**ğŸ”¸ ç›®å½•å¯¼èˆªå‘½ä»¤**
```bash
# æŸ¥çœ‹å½“å‰è¿œç¨‹ç›®å½•ä½ç½®

sftp> pwd

# åˆ‡æ¢è¿œç¨‹ç›®å½•

sftp> cd /path/to/directory

# è¿”å›ä¸Šçº§ç›®å½•

sftp> cd ..

# è¿”å›ç”¨æˆ·å®¶ç›®å½•

sftp> cd ~
```

### 3.2 æœ¬åœ°ä¸è¿œç¨‹ç›®å½•å¯¹æ¯”


**ğŸ”¸ æœ¬åœ°æ“ä½œå‘½ä»¤ï¼ˆå‰ç¼€lï¼‰**

| è¿œç¨‹å‘½ä»¤ | **æœ¬åœ°å‘½ä»¤** | **ä½œç”¨å¯¹æ¯”** |
|---------|------------|-------------|
| `pwd` | `lpwd` | `æŸ¥çœ‹å½“å‰ç›®å½•ä½ç½®` |
| `ls` | `lls` | `åˆ—å‡ºç›®å½•å†…å®¹` |
| `cd` | `lcd` | `åˆ‡æ¢å·¥ä½œç›®å½•` |

```bash
# å®é™…ä½¿ç”¨ç¤ºä¾‹

sftp> pwd          # æ˜¾ç¤ºï¼š/home/userï¼ˆè¿œç¨‹ç›®å½•ï¼‰
sftp> lpwd         # æ˜¾ç¤ºï¼š/Users/localï¼ˆæœ¬åœ°ç›®å½•ï¼‰
sftp> ls           # æ˜¾ç¤ºè¿œç¨‹æ–‡ä»¶
sftp> lls          # æ˜¾ç¤ºæœ¬åœ°æ–‡ä»¶
```

**ğŸ§  è®°å¿†æŠ€å·§**: æœ¬åœ°å‘½ä»¤éƒ½åœ¨è¿œç¨‹å‘½ä»¤å‰åŠ å­—æ¯`l`ï¼ˆlocalçš„é¦–å­—æ¯ï¼‰

### 3.3 è¿œç¨‹ç›®å½•æ“ä½œ


**ğŸ”¸ åˆ›å»ºå’Œåˆ é™¤ç›®å½•**
```bash
# åˆ›å»ºè¿œç¨‹ç›®å½•

sftp> mkdir new_directory

# åˆ›å»ºå¤šçº§ç›®å½•ï¼ˆéœ€è¦é€çº§åˆ›å»ºï¼‰

sftp> mkdir parent_dir
sftp> cd parent_dir
sftp> mkdir child_dir

# åˆ é™¤ç©ºç›®å½•

sftp> rmdir empty_directory
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> SFTPçš„`rmdir`åªèƒ½åˆ é™¤ç©ºç›®å½•ï¼Œå¦‚æœç›®å½•ä¸­æœ‰æ–‡ä»¶éœ€è¦å…ˆåˆ é™¤æ–‡ä»¶å†åˆ é™¤ç›®å½•ã€‚

---

## 4. ğŸ“¤ æ‰¹é‡æ–‡ä»¶ä¸Šä¼ ä¸‹è½½


### 4.1 å•æ–‡ä»¶ä¼ è¾“


**ğŸ”¸ ä¸‹è½½æ–‡ä»¶ï¼ˆä»è¿œç¨‹åˆ°æœ¬åœ°ï¼‰**
```bash
# åŸºæœ¬ä¸‹è½½

sftp> get remote_file.txt

# ä¸‹è½½å¹¶é‡å‘½å

sftp> get remote_file.txt local_new_name.txt

# ä¸‹è½½åˆ°æŒ‡å®šæœ¬åœ°ç›®å½•

sftp> get remote_file.txt /local/path/file.txt
```

**ğŸ”¸ ä¸Šä¼ æ–‡ä»¶ï¼ˆä»æœ¬åœ°åˆ°è¿œç¨‹ï¼‰**
```bash
# åŸºæœ¬ä¸Šä¼ 

sftp> put local_file.txt

# ä¸Šä¼ å¹¶é‡å‘½å

sftp> put local_file.txt remote_new_name.txt

# ä¸Šä¼ åˆ°æŒ‡å®šè¿œç¨‹ç›®å½•

sftp> put /local/path/file.txt /remote/path/
```

### 4.2 æ‰¹é‡æ–‡ä»¶æ“ä½œ


**ğŸ”¸ é€šé…ç¬¦æ‰¹é‡ä¼ è¾“**
```bash
# ä¸‹è½½æ‰€æœ‰txtæ–‡ä»¶

sftp> get *.txt

# ä¸Šä¼ æ‰€æœ‰jpgå›¾ç‰‡

sftp> put *.jpg

# ä¸‹è½½æŒ‡å®šæ¨¡å¼æ–‡ä»¶

sftp> get backup_*.sql
```

**ğŸ”¸ é€’å½’ç›®å½•ä¼ è¾“**
```bash
# é€’å½’ä¸‹è½½æ•´ä¸ªç›®å½•

sftp> get -r remote_directory/

# é€’å½’ä¸Šä¼ æ•´ä¸ªç›®å½•

sftp> put -r local_directory/
```

### 4.3 ä¼ è¾“è¿›åº¦ä¸çŠ¶æ€


**ğŸ”¸ æ˜¾ç¤ºä¼ è¾“è¿›åº¦**
```bash
# å¯ç”¨ä¼ è¾“è¿›åº¦æ˜¾ç¤º

sftp> progress

# å†æ¬¡æ‰§è¡Œä¼šå…³é—­è¿›åº¦æ˜¾ç¤º

sftp> progress
```

**ğŸ“Š ä¼ è¾“è¿‡ç¨‹ç¤ºä¾‹**
```
sftp> get large_file.zip
Fetching /home/user/large_file.zip to large_file.zip
/home/user/large_file.zip    45%   23MB   1.2MB/s   00:15 ETA
```

---

## 5. ğŸ¤– SFTPè„šæœ¬åŒ–æ“ä½œ


### 5.1 æ‰¹å¤„ç†æ–‡ä»¶æ¨¡å¼


**ğŸ”¸ åˆ›å»ºSFTPå‘½ä»¤è„šæœ¬**

åˆ›å»ºä¸€ä¸ªåŒ…å«SFTPå‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ï¼š
```bash
# æ–‡ä»¶åï¼šsftp_commands.txt

cd /remote/backup
put backup_*.sql
get logs/*.log
quit
```

**ğŸ”¸ æ‰§è¡Œæ‰¹å¤„ç†è„šæœ¬**
```bash
# ä½¿ç”¨ -b å‚æ•°æ‰§è¡Œæ‰¹å¤„ç†æ–‡ä»¶

sftp -b sftp_commands.txt username@hostname
```

### 5.2 æ ‡å‡†è¾“å…¥æ¨¡å¼


**ğŸ”¸ é€šè¿‡ç®¡é“ä¼ é€’å‘½ä»¤**
```bash
# å•ä¸ªå‘½ä»¤

echo "get remote_file.txt" | sftp username@hostname

# å¤šä¸ªå‘½ä»¤

echo -e "cd /backup\nget *.sql\nquit" | sftp username@hostname
```

**ğŸ”¸ hereæ–‡æ¡£æ¨¡å¼**
```bash
sftp username@hostname << EOF
cd /remote/data
put local_data.csv
get processed_data.csv
quit
EOF
```

### 5.3 è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹


**ğŸ”¸ å®Œæ•´çš„å¤‡ä»½è„šæœ¬**
```bash
#!/bin/bash

# æ–‡ä»¶åï¼šauto_backup.sh


# è®¾ç½®å˜é‡

REMOTE_HOST="backup.example.com"
REMOTE_USER="backup_user"
BACKUP_DIR="/local/backups"
REMOTE_DIR="/backup/daily"

# ç”Ÿæˆæ—¶é—´æˆ³

DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºSFTPå‘½ä»¤æ–‡ä»¶

cat > /tmp/sftp_commands << EOF
cd $REMOTE_DIR
put $BACKUP_DIR/backup_$DATE.tar.gz
ls -l
quit
EOF

# æ‰§è¡ŒSFTPä¼ è¾“

sftp -b /tmp/sftp_commands $REMOTE_USER@$REMOTE_HOST

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶

rm /tmp/sftp_commands
```

---

## 6. âš¡ æ–‡ä»¶ä¼ è¾“æ–­ç‚¹ç»­ä¼ 


### 6.1 æ–­ç‚¹ç»­ä¼ æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ **
æ–­ç‚¹ç»­ä¼ æ˜¯æŒ‡åœ¨æ–‡ä»¶ä¼ è¾“ä¸­æ–­åï¼Œèƒ½å¤Ÿä»ä¸­æ–­çš„ä½ç½®ç»§ç»­ä¼ è¾“ï¼Œè€Œä¸éœ€è¦é‡æ–°ä¼ è¾“æ•´ä¸ªæ–‡ä»¶ã€‚

**ğŸŒ° ç”Ÿæ´»ç±»æ¯”**
```
æƒ³è±¡ä½ åœ¨çœ‹ä¸€æœ¬500é¡µçš„ä¹¦ï¼š
- æ²¡æœ‰æ–­ç‚¹ç»­ä¼ ï¼šæ¯æ¬¡è¢«æ‰“æ–­éƒ½è¦ä»ç¬¬1é¡µé‡æ–°å¼€å§‹
- æœ‰æ–­ç‚¹ç»­ä¼ ï¼šè¢«æ‰“æ–­åå¯ä»¥ä»ä¹¦ç­¾ä½ç½®ç»§ç»­é˜…è¯»
```

### 6.2 SFTPæ–­ç‚¹ç»­ä¼ å®ç°


**ğŸ”¸ ä½¿ç”¨ reget å‘½ä»¤**
```bash
# ç»­ä¼ ä¸‹è½½æ–‡ä»¶

sftp> reget large_file.zip

# ç»­ä¼ ä¸‹è½½å¹¶é‡å‘½å

sftp> reget remote_large_file.zip local_resumed_file.zip
```

**ğŸ”¸ ä½¿ç”¨ reput å‘½ä»¤**
```bash
# ç»­ä¼ ä¸Šä¼ æ–‡ä»¶

sftp> reput large_upload.tar.gz

# ç»­ä¼ ä¸Šä¼ åˆ°æŒ‡å®šä½ç½®

sftp> reput local_file.zip /remote/path/file.zip
```

### 6.3 æ–­ç‚¹ç»­ä¼ å®æˆ˜åœºæ™¯


**ğŸ“Š ç»­ä¼ è¿‡ç¨‹ç¤ºä¾‹**
```
# ç¬¬ä¸€æ¬¡ä¼ è¾“ï¼ˆè¢«ä¸­æ–­ï¼‰

sftp> get huge_database.sql
huge_database.sql    23%   45MB   500KB/s   è¿æ¥ä¸­æ–­...

# ç»­ä¼ å‘½ä»¤

sftp> reget huge_database.sql
Resume download of huge_database.sql? (y/n) y
huge_database.sql    23%â†’100%   195MB   800KB/s   å®Œæˆ
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> åœ¨ç½‘ç»œä¸ç¨³å®šçš„ç¯å¢ƒä¸­ï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨`reget`å’Œ`reput`å‘½ä»¤ï¼Œå³ä½¿æ˜¯ç¬¬ä¸€æ¬¡ä¼ è¾“ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šè‡ªåŠ¨å¼€å§‹æ–°çš„ä¼ è¾“ã€‚

---

## 7. ğŸ” è¿œç¨‹æ–‡ä»¶æƒé™ç®¡ç†


### 7.1 æŸ¥çœ‹æ–‡ä»¶æƒé™


**ğŸ”¸ è¯¦ç»†åˆ—å‡ºæ–‡ä»¶æƒé™**
```bash
# æŸ¥çœ‹æ–‡ä»¶è¯¦ç»†æƒé™ä¿¡æ¯

sftp> ls -l

# ç¤ºä¾‹è¾“å‡ºè§£è¯»

-rw-r--r-- 1 user group 1024 Sep 19 15:30 document.txt
drwxr-xr-x 2 user group 4096 Sep 19 15:25 folder/
```

**ğŸ”¸ æƒé™ä¿¡æ¯è§£è¯»**
```
æƒé™ä½è§£æï¼š
-rw-r--r--
â”‚â””â”¬â”˜â””â”¬â”˜â””â”¬â”˜
â”‚ â”‚  â”‚  â””â”€å…¶ä»–ç”¨æˆ·æƒé™ï¼šr--ï¼ˆåªè¯»ï¼‰
â”‚ â”‚  â””â”€ç»„æƒé™ï¼šr--ï¼ˆåªè¯»ï¼‰  
â”‚ â””â”€æ‰€æœ‰è€…æƒé™ï¼šrw-ï¼ˆè¯»å†™ï¼‰
â””â”€æ–‡ä»¶ç±»å‹ï¼š-ï¼ˆæ™®é€šæ–‡ä»¶ï¼‰dï¼ˆç›®å½•ï¼‰
```

### 7.2 ä¿®æ”¹æ–‡ä»¶æƒé™


**ğŸ”¸ ä½¿ç”¨ chmod å‘½ä»¤**
```bash
# æ•°å­—æƒé™æ¨¡å¼

sftp> chmod 644 document.txt  # rw-r--r--
sftp> chmod 755 script.sh     # rwxr-xr-x

# ç¬¦å·æƒé™æ¨¡å¼  

sftp> chmod u+x script.sh     # ç»™æ‰€æœ‰è€…æ·»åŠ æ‰§è¡Œæƒé™
sftp> chmod g-w document.txt  # ç§»é™¤ç»„çš„å†™æƒé™
sftp> chmod a+r readme.txt    # ç»™æ‰€æœ‰äººæ·»åŠ è¯»æƒé™
```

**ğŸ”¸ å¸¸ç”¨æƒé™æ•°å­—å¯¹ç…§**

| æƒé™ç»„åˆ | **æ•°å­—** | **å«ä¹‰** | **é€‚ç”¨åœºæ™¯** |
|---------|----------|---------|-------------|
| `rw-r--r--` | `644` | `æ–‡ä»¶æ ‡å‡†æƒé™` | `æ™®é€šæ–‡æ¡£æ–‡ä»¶` |
| `rwxr-xr-x` | `755` | `å¯æ‰§è¡Œæ–‡ä»¶æƒé™` | `è„šæœ¬å’Œç¨‹åº` |
| `rw-------` | `600` | `ç§æœ‰æ–‡ä»¶æƒé™` | `å¯†é’¥å’Œé…ç½®æ–‡ä»¶` |
| `rwxrwxrwx` | `777` | `å®Œå…¨å¼€æ”¾æƒé™` | `ä¸´æ—¶æ–‡ä»¶ï¼ˆæ…ç”¨ï¼‰` |

### 7.3 ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…


**ğŸ”¸ ä½¿ç”¨ chown å’Œ chgrp**
```bash
# ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…

sftp> chown newuser document.txt

# ä¿®æ”¹æ–‡ä»¶ç»„

sftp> chgrp newgroup document.txt

# åŒæ—¶ä¿®æ”¹æ‰€æœ‰è€…å’Œç»„

sftp> chown newuser:newgroup document.txt
```

> âš ï¸ **æƒé™é™åˆ¶**  
> åªæœ‰æ–‡ä»¶æ‰€æœ‰è€…æˆ–å…·æœ‰ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·æ‰èƒ½ä¿®æ”¹æ–‡ä»¶æƒé™å’Œæ‰€æœ‰è€…ã€‚

---

## 8. ğŸ  SFTP chrootç›‘ç‹±é…ç½®


### 8.1 chrootæ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯chrootç›‘ç‹±**
chrootæ˜¯"change root"çš„ç¼©å†™ï¼Œå®ƒèƒ½å¤Ÿé™åˆ¶ç”¨æˆ·åªèƒ½è®¿é—®æŒ‡å®šç›®å½•åŠå…¶å­ç›®å½•ï¼Œç”¨æˆ·æ— æ³•è®¿é—®ä¸Šçº§ç›®å½•ã€‚

**ğŸŒ° å½¢è±¡ç†è§£**
```
æ²¡æœ‰chrooté™åˆ¶ï¼š
ç”¨æˆ·å¯ä»¥è®¿é—®æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ
/
â”œâ”€â”€ home/          â† ç”¨æˆ·å¯ä»¥è®¿é—®
â”œâ”€â”€ etc/           â† ç”¨æˆ·ä¹Ÿå¯ä»¥è®¿é—®
â”œâ”€â”€ var/           â† ç”¨æˆ·è¿˜å¯ä»¥è®¿é—®
â””â”€â”€ root/          â† ç”šè‡³å¯ä»¥è®¿é—®è¿™é‡Œ

æœ‰chrooté™åˆ¶ï¼š
ç”¨æˆ·åªèƒ½çœ‹åˆ°æŒ‡å®šç›®å½•
/home/user/        â† è¿™å°±æ˜¯ç”¨æˆ·çš„"å…¨ä¸–ç•Œ"
â”œâ”€â”€ documents/     â† åªèƒ½è®¿é—®è¿™äº›
â”œâ”€â”€ uploads/       
â””â”€â”€ downloads/     
```

### 8.2 é…ç½®SFTP chroot


**ğŸ”¸ ç¼–è¾‘SSHé…ç½®æ–‡ä»¶**
```bash
# ç¼–è¾‘SSHæœåŠ¡é…ç½®

sudo vim /etc/ssh/sshd_config
```

**ğŸ”¸ æ·»åŠ chrooté…ç½®**
```bash
# åœ¨é…ç½®æ–‡ä»¶æœ«å°¾æ·»åŠ 

Match Group sftponly
    ChrootDirectory /home/%u
    ForceCommand internal-sftp
    AllowTcpForwarding no
    X11Forwarding no
```

**ğŸ”¸ é…ç½®å‚æ•°è§£é‡Š**

| é…ç½®é¡¹ | **ä½œç”¨** | **è§£é‡Š** |
|--------|----------|----------|
| `Match Group sftponly` | `åŒ¹é…ç”¨æˆ·ç»„` | `åªå¯¹sftponlyç»„ç”¨æˆ·ç”Ÿæ•ˆ` |
| `ChrootDirectory /home/%u` | `è®¾ç½®æ ¹ç›®å½•` | `%uä»£è¡¨ç”¨æˆ·åï¼Œå³/home/username` |
| `ForceCommand internal-sftp` | `å¼ºåˆ¶SFTPæ¨¡å¼` | `ç”¨æˆ·åªèƒ½ä½¿ç”¨SFTPï¼Œæ— æ³•æ‰§è¡Œshell` |
| `AllowTcpForwarding no` | `ç¦ç”¨ç«¯å£è½¬å‘` | `å¢å¼ºå®‰å…¨æ€§` |

### 8.3 åˆ›å»ºchrootç”¨æˆ·


**ğŸ”¸ åˆ›å»ºä¸“ç”¨ç”¨æˆ·ç»„**
```bash
# åˆ›å»ºSFTPä¸“ç”¨ç»„

sudo groupadd sftponly
```

**ğŸ”¸ åˆ›å»ºå—é™ç”¨æˆ·**
```bash
# åˆ›å»ºç”¨æˆ·å¹¶æŒ‡å®šç»„

sudo useradd -g sftponly -d /home/sftpuser -s /bin/false sftpuser

# è®¾ç½®ç”¨æˆ·å¯†ç 

sudo passwd sftpuser

# åˆ›å»ºç”¨æˆ·å®¶ç›®å½•

sudo mkdir -p /home/sftpuser

# è®¾ç½®ç›®å½•æƒé™ï¼ˆé‡è¦ï¼‰

sudo chown root:root /home/sftpuser
sudo chmod 755 /home/sftpuser

# åˆ›å»ºç”¨æˆ·å¯å†™ç›®å½•

sudo mkdir /home/sftpuser/uploads
sudo chown sftpuser:sftponly /home/sftpuser/uploads
```

**ğŸ”¸ é‡å¯SSHæœåŠ¡**
```bash
sudo systemctl restart sshd
```

### 8.4 chrooté…ç½®éªŒè¯


**ğŸ”¸ æµ‹è¯•chrootæ•ˆæœ**
```bash
# è¿æ¥å—é™ç”¨æˆ·

sftp sftpuser@localhost

# å°è¯•æŸ¥çœ‹æ ¹ç›®å½•

sftp> cd /
sftp> pwd
/

# å°è¯•åˆ—å‡ºç›®å½•ï¼ˆåªèƒ½çœ‹åˆ°ç”¨æˆ·ç›®å½•å†…å®¹ï¼‰

sftp> ls
uploads

# å°è¯•è®¿é—®ç³»ç»Ÿç›®å½•ï¼ˆä¼šå¤±è´¥ï¼‰

sftp> cd /etc
Permission denied
```

---

## 9. ğŸ“‹ SFTPæ—¥å¿—è®°å½•ä¸å®¡è®¡


### 9.1 å¯ç”¨SFTPæ—¥å¿—


**ğŸ”¸ é…ç½®SSHæ—¥å¿—çº§åˆ«**
```bash
# ç¼–è¾‘SSHé…ç½®æ–‡ä»¶

sudo vim /etc/ssh/sshd_config

# è®¾ç½®æ—¥å¿—çº§åˆ«

LogLevel INFO

# æˆ–è€…æ›´è¯¦ç»†çš„æ—¥å¿—

LogLevel VERBOSE
```

**ğŸ”¸ é…ç½®ç³»ç»Ÿæ—¥å¿—**
```bash
# ç¼–è¾‘rsyslogé…ç½®

sudo vim /etc/rsyslog.conf

# æ·»åŠ SSHæ—¥å¿—åˆ†ç¦»é…ç½®

auth.info /var/log/sftp.log
```

### 9.2 æ—¥å¿—ä¿¡æ¯è§£è¯»


**ğŸ”¸ SFTPè¿æ¥æ—¥å¿—ç¤ºä¾‹**
```bash
# æŸ¥çœ‹SSH/SFTPæ—¥å¿—

sudo tail -f /var/log/auth.log

# å…¸å‹æ—¥å¿—å†…å®¹

Sep 19 15:30:01 server sshd[12345]: Accepted password for sftpuser from 192.168.1.100
Sep 19 15:30:02 server internal-sftp[12346]: session opened for local user sftpuser
Sep 19 15:30:15 server internal-sftp[12346]: open "/uploads/document.txt" flags WRITE,CREATE
Sep 19 15:30:20 server internal-sftp[12346]: close "/uploads/document.txt"
Sep 19 15:30:25 server internal-sftp[12346]: session closed for local user sftpuser
```

### 9.3 æ—¥å¿—å®¡è®¡åˆ†æ


**ğŸ”¸ å¸¸ç”¨æ—¥å¿—åˆ†æå‘½ä»¤**
```bash
# æŸ¥çœ‹SFTPè¿æ¥è®°å½•

grep "internal-sftp" /var/log/auth.log

# ç»Ÿè®¡ç”¨æˆ·è¿æ¥æ¬¡æ•°

grep "session opened" /var/log/auth.log | cut -d' ' -f9 | sort | uniq -c

# æŸ¥çœ‹æ–‡ä»¶æ“ä½œè®°å½•

grep "open\|close" /var/log/auth.log

# æŸ¥çœ‹å¤±è´¥çš„è¿æ¥å°è¯•

grep "Failed password" /var/log/auth.log
```

**ğŸ”¸ åˆ›å»ºç›‘æ§è„šæœ¬**
```bash
#!/bin/bash

# æ–‡ä»¶åï¼šsftp_monitor.sh


LOG_FILE="/var/log/auth.log"
REPORT_FILE="/tmp/sftp_daily_report.txt"

echo "SFTP æ—¥å¸¸æ´»åŠ¨æŠ¥å‘Š - $(date)" > $REPORT_FILE
echo "================================" >> $REPORT_FILE

# ç»Ÿè®¡ä»Šæ—¥è¿æ¥æ•°

TODAY=$(date +%b\ %d)
CONNECTIONS=$(grep "$TODAY.*internal-sftp.*session opened" $LOG_FILE | wc -l)
echo "ä»Šæ—¥SFTPè¿æ¥æ€»æ•°: $CONNECTIONS" >> $REPORT_FILE

# ç»Ÿè®¡æ´»è·ƒç”¨æˆ·

echo "" >> $REPORT_FILE
echo "æ´»è·ƒç”¨æˆ·ç»Ÿè®¡:" >> $REPORT_FILE
grep "$TODAY.*internal-sftp.*session opened" $LOG_FILE | \
    awk '{print $9}' | sort | uniq -c | sort -nr >> $REPORT_FILE

# æ–‡ä»¶ä¼ è¾“ç»Ÿè®¡

UPLOADS=$(grep "$TODAY.*internal-sftp.*open.*WRITE" $LOG_FILE | wc -l)
DOWNLOADS=$(grep "$TODAY.*internal-sftp.*open.*READ" $LOG_FILE | wc -l)
echo "" >> $REPORT_FILE
echo "æ–‡ä»¶ä¼ è¾“ç»Ÿè®¡:" >> $REPORT_FILE
echo "ä¸Šä¼ æ“ä½œ: $UPLOADS" >> $REPORT_FILE
echo "ä¸‹è½½æ“ä½œ: $DOWNLOADS" >> $REPORT_FILE

# å‘é€æŠ¥å‘Šï¼ˆå¯é€‰ï¼‰

# mail -s "SFTP Daily Report" admin@example.com < $REPORT_FILE

```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ SFTPæ ¸å¿ƒç†è§£**
- SFTPæ˜¯SSHçš„å­ç³»ç»Ÿï¼Œä¸æ˜¯ç‹¬ç«‹åè®®
- æ‰€æœ‰ä¼ è¾“éƒ½æ˜¯åŠ å¯†çš„ï¼Œæ¯”FTPæ›´å®‰å…¨  
- æ—¢èƒ½ä¼ è¾“æ–‡ä»¶ï¼Œä¹Ÿèƒ½æ‰§è¡Œæ–‡ä»¶ç®¡ç†æ“ä½œ
- æ”¯æŒäº¤äº’å¼æ“ä½œå’Œè„šæœ¬åŒ–æ‰¹å¤„ç†

**ğŸ”¸ åŸºæœ¬æ“ä½œå‘½ä»¤**
```
è¿æ¥: sftp user@host
æµè§ˆ: ls, pwd, cd
ä¼ è¾“: get, put, reget, reput  
ç®¡ç†: mkdir, rmdir, chmod, chown
é€€å‡º: quit, exit
```

### 10.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ äº¤äº’å¼vsè„šæœ¬åŒ–**
- **äº¤äº’å¼**: é€‚åˆä¸´æ—¶æ“ä½œå’Œå­¦ä¹ è°ƒè¯•
- **è„šæœ¬åŒ–**: é€‚åˆè‡ªåŠ¨åŒ–ä»»åŠ¡å’Œæ‰¹é‡å¤„ç†
- **é€‰æ‹©åŸåˆ™**: é‡å¤æ€§ä»»åŠ¡ä¼˜å…ˆè€ƒè™‘è„šæœ¬åŒ–

**ğŸ”¹ å®‰å…¨é…ç½®æœ€ä½³å®è·µ**
```
âœ… æ¨èåšæ³•:
- ä½¿ç”¨chrooté™åˆ¶ç”¨æˆ·è®¿é—®èŒƒå›´
- å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•
- å®šæœŸå®¡è®¡ç”¨æˆ·æ´»åŠ¨
- ä½¿ç”¨å¯†é’¥è®¤è¯æ›¿ä»£å¯†ç 

âŒ é¿å…åšæ³•:
- ç»™SFTPç”¨æˆ·è¿‡å¤šç³»ç»Ÿæƒé™
- å¿½ç•¥æ—¥å¿—ç›‘æ§
- ä½¿ç”¨å¼±å¯†ç 
- ç¦ç”¨æ‰€æœ‰å®‰å…¨ç‰¹æ€§
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
- ä½¿ç”¨å‹ç¼©ä¼ è¾“ï¼ˆ`-C`å‚æ•°ï¼‰å‡å°‘ç½‘ç»œè´Ÿæ‹…
- åˆ©ç”¨æ–­ç‚¹ç»­ä¼ é¿å…é‡å¤ä¼ è¾“å¤§æ–‡ä»¶
- æ‰¹é‡æ“ä½œæ¯”å•ä¸ªæ“ä½œæ›´é«˜æ•ˆ
- åœ¨ç½‘ç»œç¨³å®šæ—¶æ®µè¿›è¡Œå¤§æ–‡ä»¶ä¼ è¾“

### 10.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯**
- **ç½‘ç«™ç»´æŠ¤**: ä¸Šä¼ ç½‘é¡µæ–‡ä»¶å’Œèµ„æº
- **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½é‡è¦æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨
- **æ–‡ä»¶åŒæ­¥**: åœ¨ä¸åŒæœåŠ¡å™¨é—´åŒæ­¥æ•°æ®
- **å®‰å…¨ä¼ è¾“**: æ›¿ä»£ä¸å®‰å…¨çš„FTPè¿›è¡Œæ–‡ä»¶ä¼ è¾“

**ğŸ”§ è¿ç»´å®è·µå»ºè®®**
- ä¸ºä¸åŒç”¨é€”åˆ›å»ºä¸“é—¨çš„SFTPç”¨æˆ·
- å»ºç«‹æ ‡å‡†çš„æ–‡ä»¶ä¼ è¾“æµç¨‹
- å®šæœŸæ£€æŸ¥å’Œæ¸…ç†ä¼ è¾“æ—¥å¿—
- åˆ¶å®šåº”æ€¥é¢„æ¡ˆå¤„ç†ä¼ è¾“ä¸­æ–­é—®é¢˜

**ğŸ§  å­¦ä¹ è¿›é˜¶è·¯å¾„**
1. **åŸºç¡€ç†Ÿç»ƒ**: æŒæ¡åŸºæœ¬SFTPå‘½ä»¤å’Œæ“ä½œ
2. **è„šæœ¬ç¼–å†™**: å­¦ä¼šç¼–å†™è‡ªåŠ¨åŒ–ä¼ è¾“è„šæœ¬  
3. **å®‰å…¨é…ç½®**: ç†è§£chrootå’Œæƒé™ç®¡ç†
4. **ç›‘æ§å®¡è®¡**: å»ºç«‹å®Œå–„çš„æ—¥å¿—ç›‘æ§ä½“ç³»
5. **æ€§èƒ½ä¼˜åŒ–**: é’ˆå¯¹ç‰¹å®šåœºæ™¯ä¼˜åŒ–ä¼ è¾“æ•ˆç‡

### 10.4 æ•…éšœæ’é™¤æŒ‡å—


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**
```bash
# è¿æ¥é—®é¢˜

sftp -v user@host  # è¯¦ç»†æ¨¡å¼æŸ¥çœ‹è¿æ¥è¿‡ç¨‹

# æƒé™é—®é¢˜  

ls -l              # æ£€æŸ¥æ–‡ä»¶æƒé™
pwd                # ç¡®è®¤å½“å‰ç›®å½•

# ä¼ è¾“é—®é¢˜

progress           # å¼€å¯è¿›åº¦æ˜¾ç¤º
reget filename     # ä½¿ç”¨æ–­ç‚¹ç»­ä¼ 
```

**ğŸ“ è·å–å¸®åŠ©**
- ä½¿ç”¨`help`å‘½ä»¤æŸ¥çœ‹å¯ç”¨å‘½ä»¤
- ä½¿ç”¨`man sftp`æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
- æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—å®šä½é—®é¢˜æ ¹æº

**æ ¸å¿ƒè®°å¿†å£è¯€**:
- SFTPå®‰å…¨ä¼ æ–‡ä»¶ï¼ŒSSHé€šé“ä¿å®‰å…¨
- äº¤äº’è„šæœ¬ä¸¤æ¨¡å¼ï¼Œæ‰¹é‡è‡ªåŠ¨æ›´é«˜æ•ˆ  
- chrootç›‘ç‹±é™æƒé™ï¼Œæ—¥å¿—å®¡è®¡ä¿åˆè§„
- æ–­ç‚¹ç»­ä¼ ä¸æ€•æ–­ï¼Œæƒé™ç®¡ç†è¦è§„èŒƒ