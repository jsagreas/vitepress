---
title: 2、getfacl命令查看ACL权限
---
## 📚 目录

1. [getfacl基础概念](#1-getfacl基础概念)
2. [getfacl基本语法使用](#2-getfacl基本语法使用)
3. [ACL输出格式解读](#3-ACL输出格式解读)
4. [递归查看目录ACL](#4-递归查看目录ACL)
5. [默认ACL与访问ACL区别](#5-默认ACL与访问ACL区别)
6. [ACL掩码与有效权限](#6-ACL掩码与有效权限)
7. [ACL继承状态查看](#7-ACL继承状态查看)
8. [批量ACL信息获取](#8-批量ACL信息获取)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🔍 getfacl基础概念


### 1.1 什么是getfacl


**简单理解**：就像查看房子钥匙分配情况的工具

```
传统权限查看：           ACL权限查看：
ls -l file.txt          getfacl file.txt
-rw-r--r-- 1 user       # file: file.txt
                        # owner: user
只能看到基本权限          # group: group
                        user::rw-
                        user:alice:r--
                        group::r--
                        mask::r--
                        other::r--
                        
                        能看到详细的权限分配
```

> **💡 核心理解**
> getfacl = **get** + **facl**（文件访问控制列表）
> 它是专门用来查看文件和目录详细权限信息的工具

### 1.2 为什么需要getfacl


**传统权限的局限性**：
```
问题场景：
项目目录需要给多个不同用户设置不同权限
- alice需要读写权限
- bob只需要读权限  
- carol需要执行权限

传统权限：owner + group + other = 只有3种角色
ACL权限：可以给任意多个用户/组设置不同权限
```

**ACL的优势**：
- 🎯 **精细控制**：每个用户都可以有不同权限
- 🎯 **灵活分配**：不受传统3角色限制
- 🎯 **继承机制**：目录可以设置默认权限给新文件

---

## 2. ⌨️ getfacl基本语法使用


### 2.1 基本命令格式


```bash
# 最基本的用法
getfacl filename

# 常用选项组合
getfacl [选项] 文件或目录名
```

### 2.2 核心选项详解


| 选项 | 含义 | 实际作用 | 使用场景 |
|------|------|----------|----------|
| `-a` | 显示访问ACL | 只显示访问权限，不显示默认权限 | 查看当前文件权限 |
| `-d` | 显示默认ACL | 只显示默认权限，不显示访问权限 | 查看目录继承规则 |
| `-c` | 跳过注释 | 不显示文件名等注释信息 | 脚本处理时使用 |
| `-e` | 显示有效权限 | 计算并显示实际生效的权限 | 排查权限问题 |
| `-R` | 递归显示 | 显示目录及其所有子项的ACL | 查看整个目录树 |

### 2.3 基本使用示例


```bash
# 查看单个文件的ACL
getfacl /home/project/data.txt

# 查看目录的ACL（包括默认权限）
getfacl /home/shared/

# 只看访问权限，不看默认权限
getfacl -a /home/shared/

# 递归查看整个目录树
getfacl -R /home/project/
```

---

## 3. 📋 ACL输出格式解读


### 3.1 ACL输出结构图解


```
getfacl /home/project/file.txt 的输出：

┌─ 文件信息区 ─────────────────┐
│ # file: /home/project/file.txt │ ← 文件路径
│ # owner: alice                 │ ← 文件所有者  
│ # group: developers            │ ← 文件所属组
├─ 权限条目区 ────────────────┤
│ user::rw-                      │ ← 所有者权限
│ user:bob:r--                   │ ← 特定用户权限
│ group::r--                     │ ← 所属组权限
│ group:admins:rw-               │ ← 特定组权限
│ mask::rw-                      │ ← 权限掩码
│ other::---                     │ ← 其他人权限
└────────────────────────────────┘
```

### 3.2 权限条目格式详解


**权限条目格式**：`类型:名称:权限`

```
解析每一行的含义：

user::rw-          → 所有者alice有读写权限
user:bob:r--       → 用户bob只有读权限
group::r--         → 所属组developers有读权限
group:admins:rw-   → 组admins有读写权限
mask::rw-          → 掩码限制最大权限为rw-
other::---         → 其他人没有任何权限
```

> **💡 权限字母含义**
> - `r` = read（读）= 4
> - `w` = write（写）= 2  
> - `x` = execute（执行）= 1
> - `-` = 没有该权限

### 3.3 实际输出示例分析


```bash
$ getfacl /home/shared/project.txt
# file: /home/shared/project.txt
# owner: manager
# group: team
user::rw-                    # 管理员：读写
user:alice:r--               # alice用户：只读
user:bob:rw-                 # bob用户：读写
group::r--                   # team组：只读
group:admins:rwx             # 管理员组：读写执行
mask::rw-                    # 掩码：限制最大权限
other::---                   # 其他人：无权限
```

**这个配置的实际效果**：
- 📌 `manager`（文件所有者）：可以读写文件
- 📌 `alice`：只能读取文件内容
- 📌 `bob`：可以读写文件（但受mask限制，实际只有rw-）
- 📌 `admins组`成员：想要rwx权限，但mask限制只能rw-
- 📌 其他所有人：完全无法访问

---

## 4. 📂 递归查看目录ACL


### 4.1 为什么需要递归查看


**应用场景**：
```
项目目录结构：
/home/project/
├── src/           ← 源代码目录
│   ├── main.py    ← 主程序
│   └── utils.py   ← 工具函数
├── data/          ← 数据目录
│   └── users.csv  ← 用户数据
└── docs/          ← 文档目录
    └── readme.md  ← 说明文档

需求：查看整个项目的权限设置情况
```

### 4.2 递归查看命令


```bash
# 查看目录及所有子项的ACL
getfacl -R /home/project/

# 只显示权限信息，不显示注释（便于脚本处理）
getfacl -R -c /home/project/

# 将结果保存到文件
getfacl -R /home/project/ > project_acl_backup.txt
```

### 4.3 递归输出解读


```bash
$ getfacl -R /home/shared/
# file: /home/shared
# owner: admin
# group: users
user::rwx
group::r-x
other::r-x
default:user::rwx       ← 注意：目录有default权限
default:group::r-x
default:other::r-x

# file: /home/shared/file1.txt
# owner: admin  
# group: users
user::rw-
group::r--
other::r--

# file: /home/shared/subdir
# owner: admin
# group: users  
user::rwx
group::r-x
other::r-x
default:user::rwx       ← 子目录也继承了default权限
default:group::r-x
default:other::r-x
```

> **⚠️ 注意事项**
> 递归查看大目录时输出信息很多，建议：
> - 先查看顶层目录了解整体结构
> - 使用 `-c` 选项减少注释信息
> - 将结果重定向到文件便于分析

---

## 5. 🔄 默认ACL与访问ACL区别


### 5.1 两种ACL类型对比


```
访问ACL vs 默认ACL：

┌─ 访问ACL ─────────────────┐  ┌─ 默认ACL ─────────────────┐
│ 作用对象：当前文件/目录     │  │ 作用对象：新建的子文件/目录 │
│ 作用时间：立即生效         │  │ 作用时间：创建新文件时生效  │
│ 显示标记：无前缀           │  │ 显示标记：default: 前缀    │  
│ 适用范围：文件和目录都有   │  │ 适用范围：只有目录才有     │
└───────────────────────────┘  └───────────────────────────┘
```

### 5.2 单独查看不同类型ACL


```bash
# 只查看访问ACL（当前权限）
getfacl -a /home/shared/

# 只查看默认ACL（继承权限）  
getfacl -d /home/shared/

# 完整查看（包含两种类型）
getfacl /home/shared/
```

### 5.3 实际对比示例


```bash
# 查看一个设置了默认ACL的目录
$ getfacl /home/shared/

# file: /home/shared
# owner: admin
# group: team
# 以下是访问ACL（控制当前目录的访问权限）
user::rwx
user:alice:r-x
group::r-x  
mask::r-x
other::r-x

# 以下是默认ACL（控制新建文件/子目录的权限）
default:user::rwx           ← 新文件的所有者权限
default:user:alice:r--      ← 新文件alice的权限
default:group::r--          ← 新文件的组权限
default:mask::r--           ← 新文件的掩码
default:other::r--          ← 新文件其他人权限
```

**实际效果验证**：
```bash
# 在该目录下创建新文件
touch /home/shared/newfile.txt

# 查看新文件的ACL
getfacl /home/shared/newfile.txt
# file: /home/shared/newfile.txt
# owner: admin
# group: team  
user::rw-                   ← 继承自default:user::rwx（文件自动去掉x）
user:alice:r--              ← 继承自default:user:alice:r--
group::r--                  ← 继承自default:group::r--
mask::r--                   ← 继承自default:mask::r--  
other::r--                  ← 继承自default:other::r--
```

> **💡 核心理解**
> - **访问ACL**：现在就生效的权限，控制"谁能对这个文件/目录做什么"
> - **默认ACL**：未来生效的权限模板，控制"在这个目录里新建的文件/目录会有什么权限"

---

## 6. 🎭 ACL掩码与有效权限


### 6.1 什么是掩码（mask）


**简单类比**：掩码就像权限的"天花板"

```
掩码的作用机制：

用户想要的权限：rwx (7)
掩码限制：      r-- (4)  ← 天花板
────────────────────────
实际有效权限：  r-- (4)  ← 不能超过天花板

另一个例子：
用户想要的权限：r-- (4)
掩码限制：      rwx (7)  ← 天花板更高
────────────────────────  
实际有效权限：  r-- (4)  ← 取较小值
```

### 6.2 掩码影响哪些权限


```bash
getfacl示例输出：
user::rwx                   ← 不受mask影响（文件所有者）
user:alice:rwx              ← 受mask影响  
user:bob:r--                ← 受mask影响
group::rw-                  ← 受mask影响
group:admins:rwx            ← 受mask影响
mask::r--                   ← 这就是掩码！
other::r--                  ← 不受mask影响
```

**受掩码影响的权限条目**：
- ✅ **特定用户**（user:username:xxx）
- ✅ **文件所属组**（group::xxx）  
- ✅ **特定组**（group:groupname:xxx）

**不受掩码影响的权限条目**：
- ❌ **文件所有者**（user::xxx）
- ❌ **其他人**（other::xxx）

### 6.3 查看有效权限


```bash
# 使用-e选项显示有效权限
getfacl -e /home/shared/file.txt

# 输出示例：
user::rwx
user:alice:rwx        #effective:r--    ← 显示实际有效权限
user:bob:rw-          #effective:r--    ← 显示实际有效权限
group::rw-            #effective:r--    ← 显示实际有效权限
mask::r--
other::r--
```

> **💡 有效权限计算公式**
> `有效权限 = min(用户权限, mask权限)`
> 
> 例如：用户权限是rwx(7)，mask是r--(4)，有效权限就是r--(4)

### 6.4 掩码的实际意义


**应用场景**：统一控制权限上限

```bash
场景：项目目录给多个开发者设置了不同权限
- alice: rwx (读写执行)
- bob: rw- (读写)  
- carol: r-- (只读)

突然需要临时限制所有人只能读取，不能修改：
setfacl -m mask::r-- /home/project/

结果：
- alice: 原来rwx → 现在只能r-- (受mask限制)
- bob: 原来rw- → 现在只能r-- (受mask限制)
- carol: 原来r-- → 现在还是r-- (本来就不超过mask)
```

**恢复权限**：
```bash
# 恢复较高的mask权限
setfacl -m mask::rwx /home/project/
# alice又可以rwx了，bob又可以rw-了
```

---

## 7. 👶 ACL继承状态查看


### 7.1 什么是ACL继承


**继承机制图解**：

```
父目录ACL继承示意图：

/home/project/ (父目录)
├─ default:user:alice:rw-    ← 默认ACL设置
├─ default:group:dev:r--
└─ default:other::---

    ↓ 创建新文件时
    
newfile.txt (新文件)  
├─ user:alice:rw-           ← 从default继承而来
├─ group:dev:r--           ← 从default继承而来  
└─ other::---              ← 从default继承而来
```

### 7.2 检查继承设置


```bash
# 查看目录的默认ACL设置（继承模板）
getfacl -d /home/project/

# 输出示例：
default:user::rwx
default:user:alice:rw-      ← 新文件alice权限模板
default:group::r--
default:group:developers:rw- ← 新文件developers组权限模板
default:mask::rw-           ← 新文件掩码模板
default:other::r--
```

### 7.3 验证继承效果


**步骤1：创建测试文件**
```bash
# 在有默认ACL的目录下创建文件
touch /home/project/test.txt
```

**步骤2：检查新文件权限**
```bash
getfacl /home/project/test.txt

# 预期输出：
user::rw-                   ← 继承default:user::rwx，文件自动去掉x
user:alice:rw-              ← 继承default:user:alice:rw-
group::r--                  ← 继承default:group::r--
group:developers:rw-        ← 继承default:group:developers:rw-
mask::rw-                   ← 继承default:mask::rw-
other::r--                  ← 继承default:other::r--
```

**步骤3：创建测试子目录**
```bash
mkdir /home/project/subdir
getfacl /home/project/subdir

# 子目录不仅继承访问权限，还继承默认权限：
user::rwx
user:alice:rw-  
group::r--
group:developers:rw-
mask::rw-
other::r--
default:user::rwx           ← 子目录也有默认权限，可继续传递
default:user:alice:rw-
default:group::r--
default:group:developers:rw-
default:mask::rw-
default:other::r--
```

> **⚠️ 继承规则要点**
> - **文件继承**：只继承访问ACL，自动去除执行权限
> - **目录继承**：既继承访问ACL，也继承默认ACL  
> - **权限调整**：新文件的权限会根据文件类型自动调整

---

## 8. 📊 批量ACL信息获取


### 8.1 批量查看多个文件


```bash
# 查看多个文件的ACL
getfacl file1.txt file2.txt file3.txt

# 使用通配符批量查看
getfacl /home/project/*.txt

# 查看特定类型的所有文件
getfacl /home/project/*.log
```

### 8.2 结合其他命令批量处理


```bash
# 查看所有.conf配置文件的ACL
find /etc -name "*.conf" -exec getfacl {} \;

# 查看特定用户拥有的所有文件的ACL
find /home -user alice -exec getfacl {} \;

# 查看大小超过1MB的文件的ACL
find /home -size +1M -exec getfacl {} \;
```

### 8.3 ACL信息导出与备份


**导出当前目录所有ACL**：
```bash
# 导出完整的ACL信息（包含文件路径）
getfacl -R /home/project > project_acl_backup.txt

# 导出简化的ACL信息（用于setfacl恢复）
getfacl -R -c /home/project > project_acl_restore.txt
```

**ACL备份文件示例**：
```bash
# 备份文件内容示例
$ cat project_acl_backup.txt

# file: /home/project
# owner: admin
# group: developers
user::rwx
user:alice:rw-
group::r--
mask::rw-
other::r--
default:user::rwx
default:user:alice:rw-
default:group::r--
default:mask::rw-
default:other::r--

# file: /home/project/src
# owner: admin
# group: developers  
user::rwx
user:alice:rw-
group::r--
mask::rw-
other::r--
```

### 8.4 高效的ACL查看技巧


**查看权限摘要**：
```bash
# 只显示有特殊ACL设置的文件（跳过只有基本权限的文件）
getfacl -R /home/project | grep -B3 -A10 "user:"

# 只显示设置了默认ACL的目录
getfacl -R /home/project | grep -B3 -A5 "default:"
```

**统计ACL使用情况**：
```bash
# 统计有多少文件设置了扩展ACL
find /home/project -exec getfacl {} \; 2>/dev/null | grep "user:" | wc -l

# 查看哪些用户在ACL中出现
getfacl -R /home/project 2>/dev/null | grep "user:" | cut -d: -f2 | sort | uniq
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 getfacl本质：查看文件/目录详细权限分配的工具
🔸 输出格式：文件信息 + 权限条目（类型:名称:权限）
🔸 两种ACL：访问ACL（当前生效）+ 默认ACL（继承模板）
🔸 掩码作用：限制特定用户/组权限的上限（天花板机制）
🔸 继承机制：子文件/目录从父目录默认ACL继承权限
```

### 9.2 关键命令速查


| 用途 | 命令 | 说明 |
|------|------|------|
| **基本查看** | `getfacl file` | 查看文件完整ACL |
| **递归查看** | `getfacl -R dir` | 查看目录树所有ACL |
| **只看访问权限** | `getfacl -a file` | 不显示默认ACL |
| **只看默认权限** | `getfacl -d dir` | 只显示继承模板 |
| **查看有效权限** | `getfacl -e file` | 显示mask计算后的实际权限 |
| **简化输出** | `getfacl -c file` | 不显示注释信息 |

### 9.3 实用技巧总结


**🔹 排查权限问题的思路**：
```
1. 先用getfacl查看完整ACL设置
2. 关注mask值是否限制了权限  
3. 检查用户是否在正确的ACL条目中
4. 使用-e选项查看实际有效权限
5. 对比期望权限和实际权限找出差异
```

**🔹 权限继承的关键理解**：
```
- 只有目录才有默认ACL
- 新文件只继承访问权限，不继承执行权限
- 新目录既继承访问权限也继承默认权限
- 继承是在文件创建时发生，不是动态的
```

**🔹 掩码的实际应用价值**：
```
- 统一限制：一次性限制所有扩展权限的上限
- 临时控制：临时降低权限而不修改原设置  
- 安全防护：防止权限设置过高的安全风险
- 简化管理：不用逐个修改每个用户/组的权限
```

### 9.4 实际应用场景


- **🎯 项目权限审计**：定期检查项目目录权限分配是否合理
- **🎯 权限故障排查**：用户反映无法访问文件时快速定位问题
- **🎯 权限备份恢复**：系统维护前备份ACL，维护后恢复权限
- **🎯 权限标准化**：检查多个服务器的权限设置是否一致
- **🎯 安全合规检查**：确保敏感文件的权限符合安全要求

> **💡 核心记忆**
> getfacl是权限查看的"放大镜"：
> - 看得更细：每个用户/组的具体权限
> - 看得更全：访问权限+继承权限
> - 看得更准：考虑mask后的有效权限
> - 看得更深：权限继承的完整链路