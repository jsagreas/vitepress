---
title: 8ã€getcapä¸setcapå‘½ä»¤ä½¿ç”¨
---
## ğŸ“š ç›®å½•

1. [CapabilitiesåŸºç¡€æ¦‚å¿µ](#1-CapabilitiesåŸºç¡€æ¦‚å¿µ)
2. [getcapå‘½ä»¤è¯¦è§£](#2-getcapå‘½ä»¤è¯¦è§£)
3. [setcapå‘½ä»¤è¯¦è§£](#3-setcapå‘½ä»¤è¯¦è§£)
4. [Capabilitiesæƒé™ç±»å‹](#4-Capabilitiesæƒé™ç±»å‹)
5. [å®é™…åº”ç”¨åœºæ™¯](#5-å®é™…åº”ç”¨åœºæ™¯)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” CapabilitiesåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Capabilities


**ğŸ”¸ é€šä¿—è§£é‡Š**
```
ä¼ ç»Ÿç†è§£ï¼šLinuxæƒé™å°±åƒé—¨ç¦å¡
- rootç”¨æˆ·ï¼šä¸‡èƒ½é’¥åŒ™ï¼Œèƒ½å¼€æ‰€æœ‰é—¨
- æ™®é€šç”¨æˆ·ï¼šå—é™é’¥åŒ™ï¼Œåªèƒ½å¼€éƒ¨åˆ†é—¨

Capabilitiesæœºåˆ¶ï¼šç»†ç²’åº¦æƒé™æ§åˆ¶
- æŠŠrootçš„"ä¸‡èƒ½é’¥åŒ™"æ‹†åˆ†æˆå¾ˆå¤šå°é’¥åŒ™
- æ¯æŠŠå°é’¥åŒ™åªèƒ½å¼€ç‰¹å®šçš„é—¨
- æ™®é€šç¨‹åºå¯ä»¥è·å¾—ç‰¹å®šçš„"å°é’¥åŒ™"ï¼Œè€Œä¸éœ€è¦å®Œæ•´çš„rootæƒé™
```

**ğŸ’¡ å®é™…æ„ä¹‰**
```
é—®é¢˜åœºæ™¯ï¼š
ç½‘ç»œç¨‹åºéœ€è¦ç»‘å®š80ç«¯å£ï¼ˆéœ€è¦rootæƒé™ï¼‰
ä½†æˆ‘ä»¬ä¸æƒ³ç»™ç¨‹åºå®Œæ•´çš„rootæƒé™

ä¼ ç»Ÿæ–¹æ¡ˆï¼š
- è¦ä¹ˆç”¨rootè¿è¡Œç¨‹åºï¼ˆé£é™©å¤§ï¼‰
- è¦ä¹ˆä½¿ç”¨sudoï¼ˆéº»çƒ¦ä¸”ä¸å®‰å…¨ï¼‰

Capabilitiesæ–¹æ¡ˆï¼š
- åªç»™ç¨‹åºCAP_NET_BIND_SERVICEæƒé™
- ç¨‹åºå¯ä»¥ç»‘å®šç‰¹æƒç«¯å£ï¼Œä½†æ²¡æœ‰å…¶ä»–rootæƒé™
- æ—¢è§£å†³äº†é—®é¢˜ï¼Œåˆä¿è¯äº†å®‰å…¨
```

### 1.2 Capabilitiesçš„å·¥ä½œåŸç†


**ğŸ”§ æƒé™æ¨¡å‹å›¾**
```
ä¼ ç»Ÿæƒé™æ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   rootç”¨æˆ·      â”‚ â† æ‹¥æœ‰æ‰€æœ‰æƒé™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ™®é€šç”¨æˆ·      â”‚ â† æƒé™å—é™
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Capabilitiesæ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CAP_NET_ADMIN  â”‚  CAP_SYS_ADMIN   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ CAP_NET_BIND    â”‚  CAP_CHOWN       â”‚ â† æƒé™è¢«æ‹†åˆ†æˆå°å—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CAP_KILL        â”‚  CAP_SETUID      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“                    â†“
  ç¨‹åºAè·å¾—              ç¨‹åºBè·å¾—
ç‰¹å®šæƒé™ç»„åˆ            ä¸åŒæƒé™ç»„åˆ
```

**ğŸ“‹ ä¸‰ç§çŠ¶æ€ç±»å‹**
```
Capabilitiesæœ‰ä¸‰ç§çŠ¶æ€ï¼š

Permitted (p)ï¼šè¢«å…è®¸çš„æƒé™
- ç¨‹åºå¯ä»¥ä½¿ç”¨çš„æƒé™ä¸Šé™
- ç±»ä¼¼äº"æƒé™è®¸å¯è¯"

Inheritable (i)ï¼šå¯ç»§æ‰¿çš„æƒé™  
- å¯ä»¥ä¼ é€’ç»™å­è¿›ç¨‹çš„æƒé™
- ç±»ä¼¼äº"æƒé™é—ä¼ åŸºå› "

Effective (e)ï¼šæœ‰æ•ˆçš„æƒé™
- ç¨‹åºå½“å‰å®é™…ç”Ÿæ•ˆçš„æƒé™
- ç±»ä¼¼äº"æ­£åœ¨ä½¿ç”¨çš„æƒé™"
```

---

## 2. ğŸ” getcapå‘½ä»¤è¯¦è§£


### 2.1 åŸºæœ¬ç”¨æ³•


**ğŸ”¸ getcapå‘½ä»¤ä½œç”¨**
```
getcapå‘½ä»¤ï¼šæŸ¥çœ‹æ–‡ä»¶çš„Capabilitiesæƒé™
ä½œç”¨ï¼šå°±åƒæŸ¥çœ‹æ–‡ä»¶çš„"ç‰¹æ®Šé€šè¡Œè¯"
è¯­æ³•ï¼šgetcap [é€‰é¡¹] [æ–‡ä»¶è·¯å¾„]
```

### 2.2 æŸ¥çœ‹å•ä¸ªæ–‡ä»¶æƒé™


**ğŸ“ åŸºç¡€æŸ¥çœ‹å‘½ä»¤**
```bash
# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„Capabilities
getcap /usr/bin/ping

# è¾“å‡ºç¤ºä¾‹ï¼š
/usr/bin/ping = cap_net_raw+ep

# å«ä¹‰è§£æï¼š
# cap_net_rawï¼šæ‹¥æœ‰åŸå§‹ç½‘ç»œè®¿é—®æƒé™
# +epï¼šåœ¨effective(æœ‰æ•ˆ)å’Œpermitted(å…è®¸)çŠ¶æ€ä¸‹ç”Ÿæ•ˆ
```

**ğŸ’¡ è¾“å‡ºæ ¼å¼è§£æ**
```
æ ¼å¼ï¼šæ–‡ä»¶è·¯å¾„ = æƒé™åç§°+çŠ¶æ€æ ‡è¯†

æƒé™åç§°ï¼šå¦‚cap_net_rawã€cap_net_bind_serviceç­‰
çŠ¶æ€æ ‡è¯†ï¼š
- e = effective (æœ‰æ•ˆ)
- p = permitted (å…è®¸)  
- i = inheritable (å¯ç»§æ‰¿)

å¸¸è§ç»„åˆï¼š
+ep  ï¼šå…è®¸ä¸”æœ‰æ•ˆ
+eip ï¼šå…è®¸ã€æœ‰æ•ˆã€å¯ç»§æ‰¿
+p   ï¼šä»…å…è®¸ï¼Œéœ€è¦ç¨‹åºæ¿€æ´»
```

### 2.3 æ‰¹é‡æŸ¥çœ‹å’Œé€’å½’æŸ¥çœ‹


**ğŸ”§ æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶**
```bash
# æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶
getcap /usr/bin/ping /usr/bin/traceroute /bin/systemctl

# æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
getcap *

# é€’å½’æŸ¥çœ‹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆå¸¸ç”¨ï¼‰
getcap -r /usr/bin

# é€’å½’æŸ¥çœ‹æ•´ä¸ªç³»ç»Ÿï¼ˆæ…ç”¨ï¼Œä¼šå¾ˆæ…¢ï¼‰
getcap -r /
```

**ğŸ“Š å®é™…æ¼”ç¤º**
```bash
# æŸ¥çœ‹ç³»ç»Ÿä¸­å¸¸è§çš„æœ‰æƒé™çš„ç¨‹åº
$ getcap -r /usr/bin 2>/dev/null

è¾“å‡ºç¤ºä¾‹ï¼š
/usr/bin/ping = cap_net_raw+ep
/usr/bin/traceroute = cap_net_raw+ep  
/usr/bin/mtr = cap_net_raw+ep
/usr/bin/dumpcap = cap_net_admin,cap_net_raw+eip
```

### 2.4 è¿‡æ»¤å’ŒæŸ¥æ‰¾æŠ€å·§


**ğŸ¯ å®ç”¨æŸ¥æ‰¾æŠ€å·§**
```bash
# æŸ¥æ‰¾ç³»ç»Ÿä¸­æ‰€æœ‰æœ‰Capabilitiesçš„æ–‡ä»¶
getcap -r / 2>/dev/null | grep -v "^$"

# æŸ¥æ‰¾ç‰¹å®šæƒé™çš„æ–‡ä»¶
getcap -r /usr 2>/dev/null | grep "cap_net_raw"

# æŸ¥æ‰¾ç½‘ç»œç›¸å…³æƒé™çš„æ–‡ä»¶
getcap -r /usr/bin 2>/dev/null | grep -E "(net_|bind)"

# ä¿å­˜ç»“æœåˆ°æ–‡ä»¶ä¾›åˆ†æ
getcap -r /usr/bin 2>/dev/null > capabilities_audit.txt
```

---

## 3. âš™ï¸ setcapå‘½ä»¤è¯¦è§£


### 3.1 åŸºæœ¬ç”¨æ³•


**ğŸ”¸ setcapå‘½ä»¤ä½œç”¨**
```
setcapå‘½ä»¤ï¼šä¸ºæ–‡ä»¶è®¾ç½®Capabilitiesæƒé™
ä½œç”¨ï¼šç»™ç¨‹åºå‘æ”¾"ç‰¹æ®Šé€šè¡Œè¯" 
è¯­æ³•ï¼šsetcap [æƒé™è®¾ç½®] [æ–‡ä»¶è·¯å¾„]

æ³¨æ„ï¼šéœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œ
```

### 3.2 æƒé™è®¾ç½®è¯­æ³•


**ğŸ“ è®¾ç½®è¯­æ³•è§„åˆ™**
```
åŸºæœ¬æ ¼å¼ï¼šæƒé™åç§°+çŠ¶æ€æ ‡è¯†

å•ä¸ªæƒé™è®¾ç½®ï¼š
setcap cap_net_raw+ep /path/to/program

å¤šä¸ªæƒé™è®¾ç½®ï¼š
setcap cap_net_raw,cap_net_admin+ep /path/to/program

æƒé™çŠ¶æ€ç»„åˆï¼š
+ep  ï¼šè®¾ç½®ä¸ºæœ‰æ•ˆå’Œå…è®¸
+eip ï¼šè®¾ç½®ä¸ºæœ‰æ•ˆã€å…è®¸ã€å¯ç»§æ‰¿
+p   ï¼šä»…è®¾ç½®ä¸ºå…è®¸
=ep  ï¼šç²¾ç¡®è®¾ç½®ï¼ˆè¦†ç›–åŸæœ‰æƒé™ï¼‰
```

### 3.3 å¸¸ç”¨è®¾ç½®ç¤ºä¾‹


**ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹**
```bash
# 1. è®©æ™®é€šç¨‹åºèƒ½å¤Ÿç»‘å®šç‰¹æƒç«¯å£(80, 443ç­‰)
sudo setcap cap_net_bind_service+ep /usr/local/bin/myserver

# éªŒè¯è®¾ç½®
getcap /usr/local/bin/myserver
# è¾“å‡ºï¼š/usr/local/bin/myserver = cap_net_bind_service+ep

# 2. è®©ç¨‹åºèƒ½å¤Ÿå‘é€åŸå§‹ç½‘ç»œåŒ…ï¼ˆå¦‚pingåŠŸèƒ½ï¼‰
sudo setcap cap_net_raw+ep /usr/local/bin/myping

# 3. è®©ç¨‹åºèƒ½å¤Ÿä¿®æ”¹ç½‘ç»œæ¥å£é…ç½®
sudo setcap cap_net_admin+ep /usr/local/bin/netconfig

# 4. è®¾ç½®å¤šä¸ªæƒé™
sudo setcap cap_net_raw,cap_net_admin,cap_net_bind_service+ep /usr/local/bin/nettools
```

### 3.4 åˆ é™¤å’Œä¿®æ”¹æƒé™


**ğŸ—‘ï¸ æƒé™åˆ é™¤**
```bash
# å®Œå…¨åˆ é™¤æ–‡ä»¶çš„æ‰€æœ‰Capabilities
sudo setcap -r /usr/local/bin/myserver

# éªŒè¯åˆ é™¤ç»“æœ
getcap /usr/local/bin/myserver
# è¾“å‡ºï¼šæ— è¾“å‡ºè¡¨ç¤ºå·²åˆ é™¤

# ä¿®æ”¹æƒé™ï¼ˆè¦†ç›–åŸæœ‰è®¾ç½®ï¼‰
sudo setcap cap_net_bind_service+ep /usr/local/bin/myserver  # åŸè®¾ç½®
sudo setcap cap_net_raw+ep /usr/local/bin/myserver          # æ–°è®¾ç½®ï¼ˆè¦†ç›–ï¼‰

# æ·»åŠ æƒé™åˆ°ç°æœ‰è®¾ç½®
sudo setcap cap_net_raw,cap_net_bind_service+ep /usr/local/bin/myserver
```

---

## 4. ğŸ·ï¸ Capabilitiesæƒé™ç±»å‹


### 4.1 ç½‘ç»œç›¸å…³æƒé™


**ğŸŒ ç½‘ç»œæƒé™è¯¦è§£**
```
CAP_NET_RAWï¼š
å«ä¹‰ï¼šå‘é€å’Œæ¥æ”¶åŸå§‹ç½‘ç»œåŒ…çš„æƒé™
ç”¨é€”ï¼špingã€tracerouteã€ç½‘ç»œæ‰«æå·¥å…·
é£é™©ï¼šå¯ä»¥æ„é€ æ¶æ„ç½‘ç»œåŒ…

CAP_NET_ADMINï¼š  
å«ä¹‰ï¼šç½‘ç»œæ¥å£ç®¡ç†æƒé™
ç”¨é€”ï¼šä¿®æ”¹IPåœ°å€ã€è·¯ç”±è¡¨ã€é˜²ç«å¢™è§„åˆ™
é£é™©ï¼šå¯ä»¥å®Œå…¨æ§åˆ¶ç½‘ç»œé…ç½®

CAP_NET_BIND_SERVICEï¼š
å«ä¹‰ï¼šç»‘å®šç‰¹æƒç«¯å£ï¼ˆ<1024ï¼‰çš„æƒé™
ç”¨é€”ï¼šWebæœåŠ¡å™¨ç»‘å®š80/443ç«¯å£
é£é™©ï¼šè¾ƒä½ï¼Œåªæ˜¯ç«¯å£ç»‘å®šæƒé™

CAP_NET_BROADCASTï¼š
å«ä¹‰ï¼šå‘é€å¹¿æ’­åŒ…å’Œç›‘å¬å¤šæ’­çš„æƒé™
ç”¨é€”ï¼šDHCPæœåŠ¡å™¨ã€ç½‘ç»œå‘ç°å·¥å…·
é£é™©ï¼šå¯èƒ½é€ æˆç½‘ç»œå¹¿æ’­é£æš´
```

### 4.2 ç³»ç»Ÿç®¡ç†æƒé™


**âš™ï¸ ç³»ç»Ÿæƒé™è¯¦è§£**
```
CAP_SYS_ADMINï¼š
å«ä¹‰ï¼šç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼ˆå¾ˆå¤šåŠŸèƒ½çš„é›†åˆï¼‰
ç”¨é€”ï¼šæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€ç³»ç»Ÿè°ƒç”¨ç­‰
é£é™©ï¼šæé«˜ï¼Œå‡ ä¹ç­‰åŒäºroot

CAP_CHOWNï¼š
å«ä¹‰ï¼šä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™
ç”¨é€”ï¼šæ–‡ä»¶ç®¡ç†å·¥å…·ã€å¤‡ä»½ç¨‹åº
é£é™©ï¼šå¯ä»¥è·å¾—å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶

CAP_SETUIDï¼š
å«ä¹‰ï¼šä¿®æ”¹è¿›ç¨‹ç”¨æˆ·IDçš„æƒé™
ç”¨é€”ï¼šsuã€sudoç­‰è®¤è¯ç¨‹åº
é£é™©ï¼šå¯ä»¥åˆ‡æ¢åˆ°ä»»æ„ç”¨æˆ·èº«ä»½

CAP_KILLï¼š
å«ä¹‰ï¼šå‘é€ä¿¡å·ç»™ä»»æ„è¿›ç¨‹çš„æƒé™
ç”¨é€”ï¼šè¿›ç¨‹ç®¡ç†å·¥å…·ã€ç›‘æ§ç¨‹åº
é£é™©ï¼šå¯ä»¥ç»ˆæ­¢ä»»æ„è¿›ç¨‹
```

### 4.3 æƒé™é€‰æ‹©å»ºè®®


**ğŸ¯ æƒé™é€‰æ‹©åŸåˆ™**
```
æœ€å°æƒé™åŸåˆ™ï¼š
åªç»™ç¨‹åºå¿…éœ€çš„æœ€å°æƒé™ï¼Œä¸å¤šç»™

å¸¸ç”¨å®‰å…¨ç»„åˆï¼š
WebæœåŠ¡å™¨ï¼šCAP_NET_BIND_SERVICE+ep
ç½‘ç»œå·¥å…·ï¼šCAP_NET_RAW+ep  
æ–‡ä»¶ç®¡ç†ï¼šCAP_CHOWN+ep
ç›‘æ§ç¨‹åºï¼šCAP_NET_ADMIN+epï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

é¿å…ä½¿ç”¨çš„æƒé™ï¼š
CAP_SYS_ADMINï¼šæƒé™è¿‡å¤§ï¼Œå°½é‡é¿å…
CAP_SETUIDï¼šå®‰å…¨é£é™©é«˜
æ‰€æœ‰æƒé™ç»„åˆï¼šç­‰åŒäºrootï¼Œå¤±å»æ„ä¹‰
```

---

## 5. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 5.1 WebæœåŠ¡å™¨é…ç½®


**ğŸŒ è®©WebæœåŠ¡å™¨ä»¥érootç”¨æˆ·è¿è¡Œ**
```bash
# åœºæ™¯ï¼šéƒ¨ç½²nginxæˆ–è‡ªå®šä¹‰WebæœåŠ¡å™¨
# é—®é¢˜ï¼šéœ€è¦ç»‘å®š80ç«¯å£ä½†ä¸æƒ³ç”¨rootè¿è¡Œ

# 1. å¤åˆ¶ç¨‹åºåˆ°åˆé€‚ä½ç½®
sudo cp /path/to/mywebserver /usr/local/bin/

# 2. è®¾ç½®Capabilitiesæƒé™
sudo setcap cap_net_bind_service+ep /usr/local/bin/mywebserver

# 3. éªŒè¯è®¾ç½®
getcap /usr/local/bin/mywebserver
# è¾“å‡ºï¼š/usr/local/bin/mywebserver = cap_net_bind_service+ep

# 4. åˆ›å»ºä¸“ç”¨ç”¨æˆ·è¿è¡ŒæœåŠ¡
sudo useradd -r -s /bin/false webserver

# 5. ä»¥érootç”¨æˆ·å¯åŠ¨æœåŠ¡
sudo -u webserver /usr/local/bin/mywebserver
# ç°åœ¨ç¨‹åºå¯ä»¥ç»‘å®š80ç«¯å£ï¼Œä½†ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œ
```

### 5.2 ç½‘ç»œè¯Šæ–­å·¥å…·é…ç½®


**ğŸ”§ é…ç½®ç½‘ç»œå·¥å…·æƒé™**
```bash
# åœºæ™¯ï¼šè®©æ™®é€šç”¨æˆ·ä½¿ç”¨ç½‘ç»œè¯Šæ–­å·¥å…·

# 1. ä¸ºè‡ªå®šä¹‰pingå·¥å…·è®¾ç½®æƒé™
sudo setcap cap_net_raw+ep /usr/local/bin/myping

# 2. ä¸ºç½‘ç»œç›‘æ§å·¥å…·è®¾ç½®æƒé™
sudo setcap cap_net_raw,cap_net_admin+ep /usr/local/bin/netmonitor

# 3. éªŒè¯é…ç½®
getcap /usr/local/bin/myping
getcap /usr/local/bin/netmonitor

# ç°åœ¨æ™®é€šç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œæ— éœ€sudo
```

### 5.3 Dockerå®¹å™¨åº”ç”¨


**ğŸ³ å®¹å™¨ä¸­çš„Capabilitiesä½¿ç”¨**
```bash
# æŸ¥çœ‹å®¹å™¨ä¸­ç¨‹åºçš„æƒé™
docker exec mycontainer getcap /usr/bin/ping

# è¿è¡Œå®¹å™¨æ—¶æ·»åŠ ç‰¹å®šæƒé™
docker run --cap-add=NET_RAW myimage

# ç§»é™¤é»˜è®¤æƒé™ï¼Œåªä¿ç•™å¿…éœ€æƒé™
docker run --cap-drop=ALL --cap-add=NET_BIND_SERVICE myimage

# åœ¨å®¹å™¨å†…è®¾ç½®ç¨‹åºæƒé™
docker exec mycontainer setcap cap_net_bind_service+ep /usr/local/bin/app
```

### 5.4 æƒé™å®¡è®¡å’Œå®‰å…¨æ£€æŸ¥


**ğŸ” ç³»ç»Ÿå®‰å…¨å®¡è®¡**
```bash
# å®šæœŸæ£€æŸ¥ç³»ç»Ÿä¸­çš„Capabilitiesè®¾ç½®
#!/bin/bash
echo "=== ç³»ç»ŸCapabilitiesæƒé™å®¡è®¡ ==="
echo "æ—¥æœŸ: $(date)"
echo ""

echo "1. æŸ¥æ‰¾æ‰€æœ‰æœ‰ç‰¹æ®Šæƒé™çš„æ–‡ä»¶ï¼š"
getcap -r / 2>/dev/null | while read line; do
    if [[ -n "$line" ]]; then
        echo "  $line"
    fi
done

echo ""
echo "2. é«˜é£é™©æƒé™æ£€æŸ¥ï¼š"
getcap -r / 2>/dev/null | grep -E "(sys_admin|setuid|dac_override)" || echo "  æœªå‘ç°é«˜é£é™©æƒé™"

echo ""
echo "3. ç½‘ç»œæƒé™ç»Ÿè®¡ï¼š"
echo "  ç»‘å®šç‰¹æƒç«¯å£æƒé™: $(getcap -r / 2>/dev/null | grep -c net_bind_service)"
echo "  åŸå§‹ç½‘ç»œåŒ…æƒé™: $(getcap -r / 2>/dev/null | grep -c net_raw)"
echo "  ç½‘ç»œç®¡ç†æƒé™: $(getcap -r / 2>/dev/null | grep -c net_admin)"
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ Capabilitiesæœ¬è´¨ï¼šå°†rootæƒé™æ‹†åˆ†ä¸ºç»†ç²’åº¦æƒé™
ğŸ”¸ getcapå‘½ä»¤ï¼šæŸ¥çœ‹æ–‡ä»¶çš„ç‰¹æ®Šæƒé™è®¾ç½®
ğŸ”¸ setcapå‘½ä»¤ï¼šä¸ºæ–‡ä»¶è®¾ç½®ç‰¹æ®Šæƒé™  
ğŸ”¸ æƒé™çŠ¶æ€ï¼šeffective(e)ã€permitted(p)ã€inheritable(i)
ğŸ”¸ åº”ç”¨åœºæ™¯ï¼šè®©ç¨‹åºè·å¾—ç‰¹å®šæƒé™è€Œæ— éœ€å®Œæ•´rootæƒé™
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Capabilitiesçš„å®‰å…¨ä¼˜åŠ¿**
```
ä¼ ç»Ÿé—®é¢˜ï¼š
ç¨‹åºè¦ä¹ˆå®Œå…¨æ— æƒé™ï¼Œè¦ä¹ˆæœ‰å®Œæ•´rootæƒé™
æ— æ³•å®ç°ç²¾ç¡®çš„æƒé™æ§åˆ¶

Capabilitiesæ–¹æ¡ˆï¼š
æŠŠrootæƒé™æ‹†è§£æˆ40å¤šä¸ªå°æƒé™
ç¨‹åºåªè·å¾—å¿…éœ€çš„æƒé™ï¼Œé™ä½å®‰å…¨é£é™©
å®ç°äº†"æœ€å°æƒé™åŸåˆ™"
```

**ğŸ”¹ å‘½ä»¤ä½¿ç”¨è¦ç‚¹**
```
getcapæŸ¥çœ‹æŠ€å·§ï¼š
- ç”¨-ré€’å½’æŸ¥çœ‹ç›®å½•
- è¿‡æ»¤è¾“å‡ºä¾¿äºåˆ†æ
- å®šæœŸå®¡è®¡ç³»ç»Ÿæƒé™

setcapè®¾ç½®åŸåˆ™ï¼š
- å¿…é¡»ç”¨rootæƒé™æ‰§è¡Œ
- åªç»™å¿…éœ€çš„æœ€å°æƒé™
- æµ‹è¯•éªŒè¯æƒé™è®¾ç½®
- è®°å½•æƒé™å˜æ›´åŸå› 
```

**ğŸ”¹ å¸¸è§æƒé™ç±»å‹è®°å¿†**
```
ç½‘ç»œç›¸å…³ï¼š
- net_bind_serviceï¼šç»‘å®šç‰¹æƒç«¯å£
- net_rawï¼šå‘é€åŸå§‹ç½‘ç»œåŒ…
- net_adminï¼šç½‘ç»œæ¥å£ç®¡ç†

ç³»ç»Ÿç®¡ç†ï¼š
- sys_adminï¼šç³»ç»Ÿç®¡ç†ï¼ˆæ…ç”¨ï¼‰
- chownï¼šä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…
- killï¼šç»ˆæ­¢ä»»æ„è¿›ç¨‹
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **WebæœåŠ¡å™¨**ï¼šä»¥érootç”¨æˆ·è¿è¡Œï¼Œä½†èƒ½ç»‘å®š80ç«¯å£
- **ç›‘æ§ç¨‹åº**ï¼šè·å¾—ç½‘ç»œç®¡ç†æƒé™ï¼Œè¿›è¡Œç³»ç»Ÿç›‘æ§
- **å®¹å™¨å®‰å…¨**ï¼šåœ¨Dockerä¸­ç²¾ç¡®æ§åˆ¶ç¨‹åºæƒé™
- **å¼€å‘è°ƒè¯•**ï¼šè®©å¼€å‘å·¥å…·è·å¾—å¿…è¦çš„è°ƒè¯•æƒé™

**ğŸ”§ è¿ç»´å®è·µ**
- **æƒé™å®¡è®¡**ï¼šå®šæœŸæ£€æŸ¥ç³»ç»Ÿä¸­çš„Capabilitiesè®¾ç½®
- **å®‰å…¨åŠ å›º**ï¼šç§»é™¤ä¸å¿…è¦çš„ç‰¹æ®Šæƒé™
- **æ•…éšœæ’æŸ¥**ï¼šè§£å†³æƒé™ä¸è¶³å¯¼è‡´çš„ç¨‹åºè¿è¡Œé—®é¢˜
- **åˆè§„ç®¡ç†**ï¼šç¡®ä¿æƒé™è®¾ç½®ç¬¦åˆå®‰å…¨è§„èŒƒ

**ğŸ¯ å­¦ä¹ è¦ç‚¹**
- ç†è§£Capabilitiesæ˜¯ç°ä»£Linuxå®‰å…¨çš„é‡è¦æœºåˆ¶
- æŒæ¡getcapå’Œsetcapçš„æ—¥å¸¸ä½¿ç”¨æ–¹æ³•
- å­¦ä¼šé€‰æ‹©åˆé€‚çš„æƒé™ç±»å‹å’ŒçŠ¶æ€ç»„åˆ
- å…»æˆå®šæœŸå®¡è®¡å’Œæ£€æŸ¥æƒé™çš„ä¹ æƒ¯

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- getcapçœ‹æƒé™ï¼Œsetcapæ¥è®¾ç½®
- æœ€å°æƒé™ä¿å®‰å…¨ï¼Œrootæƒé™è¦æ‹†è§£
- ç½‘ç»œç»‘å®šnet_bindï¼ŒåŸå§‹åŒ…ç”¨net_raw
- å®šæœŸå®¡è®¡å¾ˆé‡è¦ï¼Œæƒé™æ§åˆ¶è¦è®°ç‰¢