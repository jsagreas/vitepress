---
title: 4ã€è´¦æˆ·é”å®šä¸å®‰å…¨ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [è´¦æˆ·é”å®šåŸºç¡€æ¦‚å¿µ](#1-è´¦æˆ·é”å®šåŸºç¡€æ¦‚å¿µ)
2. [pam_faillockç°ä»£é”å®šæœºåˆ¶](#2-pam_faillockç°ä»£é”å®šæœºåˆ¶)
3. [ä¼ ç»Ÿpam_tally2æœºåˆ¶](#3-ä¼ ç»Ÿpam_tally2æœºåˆ¶)
4. [faillockå‘½ä»¤ç®¡ç†](#4-faillockå‘½ä»¤ç®¡ç†)
5. [å®‰å…¨ç­–ç•¥é…ç½®å®è·µ](#5-å®‰å…¨ç­–ç•¥é…ç½®å®è·µ)
6. [å®¡è®¡æ—¥å¿—ä¸ç›‘æ§](#6-å®¡è®¡æ—¥å¿—ä¸ç›‘æ§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” è´¦æˆ·é”å®šåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è´¦æˆ·é”å®šæœºåˆ¶


**é€šä¿—ç†è§£**ï¼šå°±åƒä½ å®¶çš„é—¨é”ä¸€æ ·ï¼Œå¦‚æœæœ‰äººè¿ç»­å¤šæ¬¡ç”¨é”™è¯¯çš„é’¥åŒ™å¼€é—¨ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œé—¨é”ä¼šè‡ªåŠ¨é”æ­»ä¸€æ®µæ—¶é—´ï¼Œé˜²æ­¢åäººç»§ç»­å°è¯•ã€‚

```
æ­£å¸¸ç™»å½•æµç¨‹ï¼š
ç”¨æˆ·è¾“å…¥å¯†ç  â†’ éªŒè¯æ­£ç¡® â†’ å…è®¸ç™»å½•

è´¦æˆ·é”å®šä¿æŠ¤ï¼š
ç”¨æˆ·è¾“å…¥é”™è¯¯å¯†ç  â†’ è®°å½•å¤±è´¥æ¬¡æ•° â†’ è¶…è¿‡é™åˆ¶ â†’ é”å®šè´¦æˆ· â†’ ç­‰å¾…è§£é”
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è´¦æˆ·é”å®š


**æ ¸å¿ƒç›®çš„**ï¼šé˜²æ­¢æš´åŠ›ç ´è§£æ”»å‡»

```
æ”»å‡»åœºæ™¯ç¤ºä¾‹ï¼š
é»‘å®¢è·å¾—ç”¨æˆ·åï¼šadmin
å°è¯•å¸¸è§å¯†ç ï¼š
â”œâ”€ 123456 âŒ
â”œâ”€ password âŒ 
â”œâ”€ admin123 âŒ
â”œâ”€ 000000 âŒ
â””â”€ ... (ç»§ç»­å°è¯•åƒä¸‡æ¬¡)

æ²¡æœ‰é”å®šæœºåˆ¶ï¼šé»‘å®¢å¯ä»¥æ— é™å°è¯•
æœ‰é”å®šæœºåˆ¶ï¼šå°è¯•3æ¬¡å¤±è´¥åè´¦æˆ·é”å®š30åˆ†é’Ÿ
```

### 1.3 é”å®šæœºåˆ¶çš„å·¥ä½œåŸç†


```
Linuxè´¦æˆ·é”å®šæ¶æ„ï¼š
         
    ç”¨æˆ·ç™»å½•è¯·æ±‚
         â†“
    PAMè®¤è¯æ¨¡å—
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   pam_faillock      â”‚ â† ç°ä»£æ¨èæ–¹æ¡ˆ
â”‚   æˆ– pam_tally2     â”‚ â† ä¼ ç»Ÿæ–¹æ¡ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    è®°å½•å¤±è´¥æ¬¡æ•°
         â†“
    åˆ¤æ–­æ˜¯å¦é”å®š
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…è®¸ç™»å½• / æ‹’ç»ç™»å½•  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ é”å®šçŠ¶æ€å­˜å‚¨ä½ç½®**ï¼š
- **pam_faillock**ï¼š`/var/run/faillock/` ç›®å½•
- **pam_tally2**ï¼š`/var/log/tallylog` æ–‡ä»¶

---

## 2. ğŸ›¡ï¸ pam_faillockç°ä»£é”å®šæœºåˆ¶


### 2.1 pam_faillockæ¦‚è¿°


**ä»€ä¹ˆæ˜¯pam_faillock**ï¼šè¿™æ˜¯Linuxç³»ç»Ÿç°ä»£çš„è´¦æˆ·é”å®šæ¨¡å—ï¼Œç”¨æ¥é˜²æ­¢å¯†ç æš´åŠ›ç ´è§£ã€‚

**ä¸ºä»€ä¹ˆé€‰æ‹©pam_faillock**ï¼š
- âœ… **åŠŸèƒ½æ›´å¼ºå¤§**ï¼šæ”¯æŒæ›´å¤šé…ç½®é€‰é¡¹
- âœ… **æ€§èƒ½æ›´å¥½**ï¼šå¤„ç†é€Ÿåº¦å¿«ï¼Œèµ„æºå ç”¨å°‘
- âœ… **ç»´æŠ¤æ´»è·ƒ**ï¼šæŒç»­æ›´æ–°ï¼Œä¿®å¤å®‰å…¨æ¼æ´
- âœ… **çµæ´»é…ç½®**ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒç­–ç•¥

### 2.2 åŸºç¡€é…ç½®æ­¥éª¤


**Step â‘ ** ç¼–è¾‘è®¤è¯é…ç½®æ–‡ä»¶

```bash
# ç¼–è¾‘ /etc/pam.d/system-auth
vi /etc/pam.d/system-auth
```

**Step â‘¡** æ·»åŠ faillocké…ç½®

```bash
# åœ¨ auth éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œï¼ˆæ³¨æ„é¡ºåºå¾ˆé‡è¦ï¼‰

# ç™»å½•å‰æ£€æŸ¥æ˜¯å¦è¢«é”å®š
auth        required      pam_faillock.so preauth audit silent deny=3 unlock_time=300

# åŸæœ‰çš„å¯†ç éªŒè¯è¡Œ
auth        sufficient    pam_unix.so nullok try_first_pass

# ç™»å½•å¤±è´¥åè®°å½•å¤±è´¥æ¬¡æ•°
auth        [default=die] pam_faillock.so authfail audit deny=3 unlock_time=300
```

**Step â‘¢** åŒæ ·é…ç½®password-auth

```bash
# ç¼–è¾‘ /etc/pam.d/password-authï¼ˆSSHç™»å½•ç”¨ï¼‰
vi /etc/pam.d/password-auth

# æ·»åŠ ç›¸åŒçš„é…ç½®
```

### 2.3 è¯¦ç»†å‚æ•°è¯´æ˜


**æ ¸å¿ƒå‚æ•°å«ä¹‰**ï¼š

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `deny=3` | å…è®¸å¤±è´¥æ¬¡æ•° | è¿ç»­3æ¬¡é”™è¯¯å°±é”å®š |
| `unlock_time=300` | é”å®šæ—¶é—´(ç§’) | é”å®š5åˆ†é’Ÿ |
| `audit` | è®°å½•å®¡è®¡æ—¥å¿— | æ‰€æœ‰å°è¯•éƒ½è®°å½• |
| `silent` | ä¸æ˜¾ç¤ºé”å®šä¿¡æ¯ | ç”¨æˆ·çœ‹ä¸åˆ°è¢«é”å®š |
| `no_log_info` | ä¸è®°å½•æˆåŠŸç™»å½• | å‡å°‘æ—¥å¿—é‡ |

**é«˜çº§å‚æ•°é…ç½®**ï¼š

```bash
# æ›´å®Œæ•´çš„é…ç½®ç¤ºä¾‹
auth required pam_faillock.so preauth \
    deny=5 \                    # å…è®¸5æ¬¡å¤±è´¥
    unlock_time=1800 \          # é”å®š30åˆ†é’Ÿ  
    fail_interval=900 \         # 15åˆ†é’Ÿå†…çš„å¤±è´¥æ‰è®¡æ•°
    root_unlock_time=60 \       # rootç”¨æˆ·åªé”å®š1åˆ†é’Ÿ
    even_deny_root \            # è¿rootç”¨æˆ·ä¹Ÿé”å®š
    audit \                     # è®°å½•å®¡è®¡æ—¥å¿—
    silent                      # é™é»˜æ¨¡å¼
```

### 2.4 é…ç½®æ–‡ä»¶æ–¹å¼


**åˆ›å»ºä¸“é—¨çš„é…ç½®æ–‡ä»¶**ï¼ˆæ¨èæ–¹å¼ï¼‰ï¼š

```bash
# åˆ›å»º /etc/security/faillock.conf
vi /etc/security/faillock.conf
```

```bash
# faillocké…ç½®æ–‡ä»¶å†…å®¹
# åŸºæœ¬è®¾ç½®
deny = 3                        # å¤±è´¥æ¬¡æ•°é™åˆ¶
unlock_time = 300               # é”å®šæ—¶é—´ï¼ˆç§’ï¼‰
fail_interval = 900             # å¤±è´¥è®¡æ•°æ—¶é—´çª—å£

# é«˜çº§è®¾ç½®  
silent                          # é™é»˜æ¨¡å¼
audit                           # å®¡è®¡æ—¥å¿—
even_deny_root                  # rootä¹Ÿè¢«é”å®š
root_unlock_time = 60           # rooté”å®šæ—¶é—´

# ç›®å½•è®¾ç½®
dir = /var/run/faillock         # é”å®šçŠ¶æ€å­˜å‚¨ç›®å½•
```

**ç®€åŒ–PAMé…ç½®**ï¼š

```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶åï¼ŒPAMé…ç½®å˜å¾—ç®€å•
auth        required      pam_faillock.so preauth
auth        sufficient    pam_unix.so nullok try_first_pass  
auth        [default=die] pam_faillock.so authfail
```

---

## 3. ğŸ”„ ä¼ ç»Ÿpam_tally2æœºåˆ¶


### 3.1 pam_tally2æ¦‚è¿°


**ä»€ä¹ˆæ˜¯pam_tally2**ï¼šè¿™æ˜¯Linuxç³»ç»Ÿè¾ƒè€çš„è´¦æˆ·é”å®šæ¨¡å—ï¼Œè™½ç„¶åŠŸèƒ½ä¸å¦‚pam_faillockå¼ºå¤§ï¼Œä½†åœ¨å¾ˆå¤šç³»ç»Ÿä¸­ä»åœ¨ä½¿ç”¨ã€‚

> **âš ï¸ é‡è¦æé†’**ï¼špam_tally2åœ¨æ–°ç‰ˆæœ¬ç³»ç»Ÿä¸­å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨pam_faillock

### 3.2 pam_tally2é…ç½®


**é…ç½®ç¤ºä¾‹**ï¼š

```bash
# ç¼–è¾‘ /etc/pam.d/system-auth
vi /etc/pam.d/system-auth

# åœ¨ auth éƒ¨åˆ†æ·»åŠ 
auth        required      pam_tally2.so deny=3 unlock_time=300 onerr=fail

# åœ¨ account éƒ¨åˆ†æ·»åŠ   
account     required      pam_tally2.so
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `deny=3` | å¤±è´¥æ¬¡æ•°é™åˆ¶ | 3æ¬¡å¤±è´¥é”å®š |
| `unlock_time=300` | è‡ªåŠ¨è§£é”æ—¶é—´ | 5åˆ†é’Ÿåè§£é” |
| `onerr=fail` | é”™è¯¯æ—¶çš„è¡Œä¸º | å‡ºé”™å°±è®¤ä¸ºå¤±è´¥ |
| `no_magic_root` | rootç”¨æˆ·ä¹Ÿé™åˆ¶ | rootä¸ä¾‹å¤– |
| `reset` | æˆåŠŸç™»å½•é‡ç½®è®¡æ•° | ç™»å½•æˆåŠŸæ¸…é›¶ |

### 3.3 pam_tally2å‘½ä»¤ä½¿ç”¨


**æŸ¥çœ‹é”å®šçŠ¶æ€**ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„å¤±è´¥æ¬¡æ•°
pam_tally2

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·
pam_tally2 --user username

# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
pam_tally2 --user username --verbose
```

**æ‰‹åŠ¨è§£é”**ï¼š

```bash
# è§£é”ç‰¹å®šç”¨æˆ·
pam_tally2 --user username --reset

# è§£é”æ‰€æœ‰ç”¨æˆ·
pam_tally2 --reset
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```bash
$ pam_tally2
Login           Failures Latest failure     From
testuser            3    09/14/25 10:30:15  192.168.1.100
admin               5    09/14/25 10:25:30  192.168.1.200
```

---

## 4. âš™ï¸ faillockå‘½ä»¤ç®¡ç†


### 4.1 faillockå‘½ä»¤æ¦‚è¿°


**ä»€ä¹ˆæ˜¯faillockå‘½ä»¤**ï¼šè¿™æ˜¯ä¸“é—¨ç”¨æ¥ç®¡ç†pam_faillocké”å®šçŠ¶æ€çš„å·¥å…·ï¼Œç›¸å½“äºé”å®šç®¡ç†çš„"é¥æ§å™¨"ã€‚

### 4.2 æŸ¥çœ‹é”å®šçŠ¶æ€


**åŸºæœ¬æŸ¥çœ‹**ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·é”å®šçŠ¶æ€
faillock

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·
faillock --user username

# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
faillock --user username --verbose
```

**è¾“å‡ºè§£é‡Š**ï¼š

```bash
$ faillock --user testuser
testuser:
When                Type  Source                                           Valid
2025-09-14 10:30:15 FAIL  192.168.1.100                                        V
2025-09-14 10:30:25 FAIL  192.168.1.100                                        V  
2025-09-14 10:30:35 FAIL  192.168.1.100                                        V
```

**å­—æ®µå«ä¹‰**ï¼š
- **When**ï¼šå¤±è´¥å‘ç”Ÿæ—¶é—´
- **Type**ï¼šäº‹ä»¶ç±»å‹ï¼ˆFAIL=å¤±è´¥ï¼ŒSUCC=æˆåŠŸï¼‰
- **Source**ï¼šç™»å½•æ¥æºIP
- **Valid**ï¼šè®°å½•æ˜¯å¦æœ‰æ•ˆ

### 4.3 æ‰‹åŠ¨ç®¡ç†é”å®š


**è§£é”ç”¨æˆ·**ï¼š

```bash
# è§£é”ç‰¹å®šç”¨æˆ·
faillock --user username --reset

# è§£é”æ‰€æœ‰ç”¨æˆ·  
faillock --reset
```

**éªŒè¯è§£é”**ï¼š

```bash
# è§£é”å‰
$ faillock --user testuser
testuser: 3 failures

# æ‰§è¡Œè§£é”
$ faillock --user testuser --reset

# è§£é”å
$ faillock --user testuser  
testuser: 0 failures
```

### 4.4 å®ç”¨æŸ¥çœ‹æŠ€å·§


**ç»Ÿè®¡é”å®šç”¨æˆ·**ï¼š

```bash
# æŸ¥çœ‹å½“å‰è¢«é”å®šçš„ç”¨æˆ·
faillock | grep -B1 "failures" | grep -v "^--$" | grep -v "failures"

# ç»Ÿè®¡é”å®šç”¨æˆ·æ•°é‡
faillock | grep -c "failures"
```

**æ£€æŸ¥ç‰¹å®šæ—¶é—´æ®µ**ï¼š

```bash
# æŸ¥çœ‹æœ€è¿‘1å°æ—¶çš„å¤±è´¥ç™»å½•
faillock | awk '$2 >= "'$(date -d '1 hour ago' '+%Y-%m-%d %H:%M:%S')'"'
```

---

## 5. ğŸ¯ å®‰å…¨ç­–ç•¥é…ç½®å®è·µ


### 5.1 ç™½åå•ç”¨æˆ·æ’é™¤ç­–ç•¥


**ä»€ä¹ˆæ˜¯ç™½åå•**ï¼šå°±æ˜¯"å…æ­»é‡‘ç‰Œ"ï¼ŒæŒ‡å®šæŸäº›é‡è¦ç”¨æˆ·ä¸å—é”å®šé™åˆ¶ï¼Œé¿å…æŠŠç®¡ç†å‘˜è‡ªå·±é”åœ¨é—¨å¤–ã€‚

**å®ç°æ–¹æ³•**ï¼š

```bash
# æ–¹æ³•1ï¼šåœ¨PAMé…ç½®ä¸­æ’é™¤ç”¨æˆ·
auth required pam_faillock.so preauth deny=3 unlock_time=300 \
    user!=root user!=admin user!=emergency
```

**æ–¹æ³•2ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶**

```bash
# åœ¨ /etc/security/faillock.conf ä¸­é…ç½®
vi /etc/security/faillock.conf

# æ·»åŠ ç®¡ç†å‘˜æ’é™¤åˆ—è¡¨
admin_group = wheel              # wheelç»„ç”¨æˆ·ä¸å—é™åˆ¶
# æˆ–è€…
# åœ¨PAMé…ç½®ä¸­ä½¿ç”¨æ¡ä»¶åˆ¤æ–­
```

**æ–¹æ³•3ï¼šåˆ›å»ºä¸“é—¨çš„PAMæ–‡ä»¶**

```bash
# ä¸ºç‰¹æ®Šç”¨æˆ·åˆ›å»ºç‹¬ç«‹çš„PAMé…ç½®
cp /etc/pam.d/login /etc/pam.d/login-admin

# ç¼–è¾‘adminç‰ˆæœ¬ï¼Œå»æ‰faillocké™åˆ¶
vi /etc/pam.d/login-admin
# æ³¨é‡Šæ‰æˆ–åˆ é™¤ pam_faillock ç›¸å…³è¡Œ
```

### 5.2 åˆ†çº§é”å®šç­–ç•¥


**æ ¹æ®ç”¨æˆ·é‡è¦æ€§è®¾ç½®ä¸åŒç­–ç•¥**ï¼š

```
ç”¨æˆ·ç±»å‹åˆ†çº§ï¼š
â”œâ”€â”€ ğŸ”´ æ™®é€šç”¨æˆ·ï¼š3æ¬¡å¤±è´¥ï¼Œé”å®š30åˆ†é’Ÿ
â”œâ”€â”€ ğŸŸ¡ æœåŠ¡è´¦æˆ·ï¼š5æ¬¡å¤±è´¥ï¼Œé”å®š10åˆ†é’Ÿ  
â”œâ”€â”€ ğŸŸ¢ ç®¡ç†å‘˜ï¼š10æ¬¡å¤±è´¥ï¼Œé”å®š5åˆ†é’Ÿ
â””â”€â”€ âšª ç³»ç»Ÿç”¨æˆ·ï¼šä¸é™åˆ¶
```

**é…ç½®ç¤ºä¾‹**ï¼š

```bash
# /etc/security/faillock.conf
# æ™®é€šç”¨æˆ·é»˜è®¤ç­–ç•¥
deny = 3
unlock_time = 1800

# ä¸ºä¸åŒç±»å‹ç”¨æˆ·åˆ›å»ºä¸åŒçš„PAMé…ç½®æ–‡ä»¶
```

### 5.3 åŸºäºæ—¶é—´çš„é”å®šç­–ç•¥


**å·¥ä½œæ—¶é—´å®½æ¾ï¼Œéå·¥ä½œæ—¶é—´ä¸¥æ ¼**ï¼š

```bash
# åˆ›å»ºæ—¶é—´ç›¸å…³çš„è„šæœ¬
vi /etc/security/time-based-policy.sh

#!/bin/bash
current_hour=$(date +%H)
if [ $current_hour -ge 9 ] && [ $current_hour -le 18 ]; then
    # å·¥ä½œæ—¶é—´ï¼šå…è®¸5æ¬¡å¤±è´¥
    echo "deny=5 unlock_time=600"
else
    # éå·¥ä½œæ—¶é—´ï¼šåªå…è®¸3æ¬¡å¤±è´¥
    echo "deny=3 unlock_time=1800"
fi
```

### 5.4 IPåœ°å€ç›¸å…³ç­–ç•¥


**å†…ç½‘å®½æ¾ï¼Œå¤–ç½‘ä¸¥æ ¼**ï¼š

```bash
# åœ¨PAMé…ç½®ä¸­ä½¿ç”¨æ¡ä»¶åˆ¤æ–­
# æ£€æŸ¥æ¥æºIPæ˜¯å¦ä¸ºå†…ç½‘
auth [success=1 default=ignore] pam_access.so accessfile=/etc/security/access-internal.conf
auth required pam_faillock.so preauth deny=10 unlock_time=300
auth required pam_faillock.so preauth deny=3 unlock_time=1800
```

**access-internal.confé…ç½®**ï¼š

```bash
vi /etc/security/access-internal.conf

# å†…ç½‘IPå…è®¸å®½æ¾ç­–ç•¥
+ : ALL : 192.168.0.0/16
+ : ALL : 10.0.0.0/8  
+ : ALL : 172.16.0.0/12
- : ALL : ALL
```

---

## 6. ğŸ“Š å®¡è®¡æ—¥å¿—ä¸ç›‘æ§


### 6.1 æ—¥å¿—è®°å½•ä½ç½®


**ç³»ç»Ÿæ—¥å¿—è®°å½•ä½ç½®**ï¼š

```
ä¸»è¦æ—¥å¿—æ–‡ä»¶ï¼š
â”œâ”€â”€ /var/log/secure          â† è®¤è¯ç›¸å…³æ—¥å¿—ï¼ˆCentOS/RHELï¼‰
â”œâ”€â”€ /var/log/auth.log        â† è®¤è¯æ—¥å¿—ï¼ˆDebian/Ubuntuï¼‰
â”œâ”€â”€ /var/log/faillog         â† ç™»å½•å¤±è´¥æ—¥å¿—
â””â”€â”€ /var/log/lastlog         â† æœ€åç™»å½•è®°å½•
```

### 6.2 åˆ†æç™»å½•å¤±è´¥æ—¥å¿—


**æŸ¥çœ‹è®¤è¯å¤±è´¥è®°å½•**ï¼š

```bash
# æŸ¥çœ‹æœ€è¿‘çš„å¤±è´¥ç™»å½•
grep "authentication failure" /var/log/secure

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„å¤±è´¥è®°å½•
grep "authentication failure.*user=testuser" /var/log/secure

# ç»Ÿè®¡å¤±è´¥æ¬¡æ•°æœ€å¤šçš„ç”¨æˆ·
grep "authentication failure" /var/log/secure | \
  awk '{print $13}' | cut -d= -f2 | sort | uniq -c | sort -nr
```

**æ—¥å¿—ç¤ºä¾‹è§£è¯»**ï¼š

```bash
Sep 14 10:30:15 server pam_faillock(login:auth): 
  user testuser authentication failure; 
  ruser= rhost=192.168.1.100 user=testuser
```

**å­—æ®µå«ä¹‰**ï¼š
- **æ—¶é—´**ï¼šSep 14 10:30:15
- **æœåŠ¡**ï¼šlogin
- **ç”¨æˆ·**ï¼štestuser  
- **æ¥æº**ï¼š192.168.1.100
- **ç»“æœ**ï¼šauthentication failure

### 6.3 ç›‘æ§è„šæœ¬ç¤ºä¾‹


**å®æ—¶ç›‘æ§ç™»å½•å¤±è´¥**ï¼š

```bash
vi /usr/local/bin/monitor-faillock.sh

#!/bin/bash
# ç›‘æ§è´¦æˆ·é”å®šæƒ…å†µ

LOG_FILE="/var/log/faillock-monitor.log"
ALERT_THRESHOLD=3

while true; do
    # è·å–å½“å‰é”å®šçŠ¶æ€
    LOCKED_USERS=$(faillock | grep -c "failures")
    
    if [ $LOCKED_USERS -gt $ALERT_THRESHOLD ]; then
        echo "$(date): ALERT - $LOCKED_USERS users locked" >> $LOG_FILE
        
        # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é‚®ä»¶é€šçŸ¥
        # mail -s "Account Lockout Alert" admin@company.com < $LOG_FILE
    fi
    
    sleep 60  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
done
```

**è®¾ç½®å®šæ—¶ä»»åŠ¡**ï¼š

```bash
# æ·»åŠ åˆ°crontab
crontab -e

# æ¯5åˆ†é’Ÿç”Ÿæˆé”å®šçŠ¶æ€æŠ¥å‘Š
*/5 * * * * /usr/local/bin/generate-lockout-report.sh
```

### 6.4 æ—¥å¿—åˆ†æå®ç”¨å‘½ä»¤


**ç»Ÿè®¡åˆ†æå‘½ä»¤**ï¼š

```bash
# ç»Ÿè®¡ä»Šå¤©çš„å¤±è´¥ç™»å½•æ¬¡æ•°
grep "$(date +%b\ %d)" /var/log/secure | grep "authentication failure" | wc -l

# æ‰¾å‡ºæ”»å‡»æ¥æºIP
grep "authentication failure" /var/log/secure | \
  awk '{print $14}' | cut -d= -f2 | sort | uniq -c | sort -nr

# åˆ†ææ”»å‡»ç›®æ ‡ç”¨æˆ·
grep "authentication failure" /var/log/secure | \
  awk '{print $13}' | cut -d= -f2 | sort | uniq -c | sort -nr
```

**ç”Ÿæˆå®‰å…¨æŠ¥å‘Š**ï¼š

```bash
vi /usr/local/bin/security-report.sh

#!/bin/bash
echo "=== è´¦æˆ·å®‰å…¨çŠ¶å†µæŠ¥å‘Š ==="
echo "æŠ¥å‘Šæ—¶é—´: $(date)"
echo

echo "1. å½“å‰é”å®šç”¨æˆ·ï¼š"
faillock | grep -B1 "failures" | grep -v "^--$" | grep -v "failures"
echo

echo "2. æœ€è¿‘24å°æ—¶å¤±è´¥ç™»å½•ç»Ÿè®¡ï¼š"
grep "$(date +%b\ %d)" /var/log/secure | grep "authentication failure" | wc -l
echo

echo "3. æ”»å‡»æ¥æºIP TOP5ï¼š"
grep "authentication failure" /var/log/secure | \
  awk '{print $14}' | cut -d= -f2 | sort | uniq -c | sort -nr | head -5
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ è´¦æˆ·é”å®šæœ¬è´¨ï¼šé˜²æ­¢æš´åŠ›ç ´è§£çš„å®‰å…¨æœºåˆ¶
ğŸ”¸ ç°ä»£æ–¹æ¡ˆï¼špam_faillockï¼ˆæ¨èï¼‰vs pam_tally2ï¼ˆä¼ ç»Ÿï¼‰  
ğŸ”¸ æ ¸å¿ƒå‚æ•°ï¼šdenyï¼ˆå¤±è´¥æ¬¡æ•°ï¼‰ã€unlock_timeï¼ˆé”å®šæ—¶é—´ï¼‰
ğŸ”¸ ç®¡ç†å·¥å…·ï¼šfaillockå‘½ä»¤ç”¨äºæŸ¥çœ‹å’Œç®¡ç†é”å®šçŠ¶æ€
ğŸ”¸ æ—¥å¿—å®¡è®¡ï¼šé€šè¿‡ç³»ç»Ÿæ—¥å¿—åˆ†ææ”»å‡»æ¨¡å¼
```

### 7.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ pam_faillocké…ç½®æ­¥éª¤**ï¼š
```
Step 1: ç¼–è¾‘ /etc/pam.d/system-auth å’Œ password-auth
Step 2: æ·»åŠ  preauth å’Œ authfail ä¸¤è¡Œé…ç½®
Step 3: æˆ–è€…ä½¿ç”¨ /etc/security/faillock.conf é…ç½®æ–‡ä»¶
Step 4: æµ‹è¯•éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
```

**ğŸ”¹ é‡è¦å®‰å…¨åŸåˆ™**ï¼š
```
å¹³è¡¡æ€§ï¼šå®‰å…¨ vs å¯ç”¨æ€§
åˆ†å±‚é˜²æŠ¤ï¼šä¸åŒç”¨æˆ·ä¸åŒç­–ç•¥  
ç™½åå•æœºåˆ¶ï¼šç®¡ç†å‘˜è´¦æˆ·ä¿æŠ¤
æ—¥å¿—ç›‘æ§ï¼šåŠæ—¶å‘ç°æ”»å‡»è¡Œä¸º
åº”æ€¥é¢„æ¡ˆï¼šè¢«é”å®šæ—¶çš„è§£å†³æ–¹æ¡ˆ
```

### 7.3 å®é™…åº”ç”¨å»ºè®®


**é…ç½®å»ºè®®**ï¼š
- ğŸ¯ **æ™®é€šç¯å¢ƒ**ï¼š3æ¬¡å¤±è´¥ï¼Œé”å®š15åˆ†é’Ÿ
- ğŸ¯ **é«˜å®‰å…¨ç¯å¢ƒ**ï¼š3æ¬¡å¤±è´¥ï¼Œé”å®š30-60åˆ†é’Ÿ
- ğŸ¯ **ç®¡ç†è´¦æˆ·**ï¼šé€‚å½“æ”¾å®½é™åˆ¶ï¼Œé¿å…è‡ªé”
- ğŸ¯ **æœåŠ¡è´¦æˆ·**ï¼šè°¨æ…é…ç½®ï¼Œé˜²æ­¢æœåŠ¡ä¸­æ–­

**è¿ç»´è¦ç‚¹**ï¼š
- ğŸ“Š **å®šæœŸæ£€æŸ¥**ï¼šç›‘æ§é”å®šçŠ¶æ€å’Œæ”»å‡»è¶‹åŠ¿
- ğŸ” **æ—¥å¿—åˆ†æ**ï¼šè¯†åˆ«æ”»å‡»æ¨¡å¼å’Œæ¥æº
- âš¡ **åº”æ€¥å“åº”**ï¼šå»ºç«‹è§£é”å’Œäº‹ä»¶å“åº”æµç¨‹
- ğŸ“š **æ–‡æ¡£è®°å½•**ï¼šè®°å½•é…ç½®å’Œå˜æ›´å†å²

**æœ€ä½³å®è·µè®°å¿†**ï¼š
```
ä¸‰æ¬¡å¤±è´¥è¦é”å®šï¼Œæ—¶é—´è®¾ç½®è¦åˆç†
ç®¡ç†è´¦æˆ·ç•™åé—¨ï¼Œæ—¥å¿—ç›‘æ§ä¸èƒ½å¿˜
ç™½åå•ç­–ç•¥è¦è®¾å¥½ï¼Œåº”æ€¥é¢„æ¡ˆè¦å‡†å¤‡
å®šæœŸæ£€æŸ¥é”å®šçŠ¶æ€ï¼Œå®‰å…¨è¿ç»´ä¸¤ä¸è¯¯
```

**âš ï¸ é‡è¦æé†’**ï¼š
- é…ç½®å‰ä¸€å®šè¦æµ‹è¯•ï¼Œé¿å…æŠŠè‡ªå·±é”åœ¨å¤–é¢
- ä¿ç•™è‡³å°‘ä¸€ä¸ªä¸å—é™åˆ¶çš„ç®¡ç†å‘˜è´¦æˆ·
- å®šæœŸå¤‡ä»½PAMé…ç½®æ–‡ä»¶
- åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¦å……åˆ†æµ‹è¯•