---
title: 2ã€chrootç¯å¢ƒåˆ›å»ºä¸é…ç½®
---
## ğŸ“š ç›®å½•

1. [chrootåŸºç¡€æ¦‚å¿µä¸ä½œç”¨](#1-chrootåŸºç¡€æ¦‚å¿µä¸ä½œç”¨)
2. [chrootç¯å¢ƒç›®å½•ç»“æ„åˆ›å»º](#2-chrootç¯å¢ƒç›®å½•ç»“æ„åˆ›å»º)  
3. [ç³»ç»Ÿæ ¸å¿ƒæ–‡ä»¶å¤åˆ¶ä¸é…ç½®](#3-ç³»ç»Ÿæ ¸å¿ƒæ–‡ä»¶å¤åˆ¶ä¸é…ç½®)
4. [åŠ¨æ€åº“ä¾èµ–åˆ†æä¸å¤„ç†](#4-åŠ¨æ€åº“ä¾èµ–åˆ†æä¸å¤„ç†)
5. [è®¾å¤‡æ–‡ä»¶ä¸ç³»ç»Ÿé…ç½®](#5-è®¾å¤‡æ–‡ä»¶ä¸ç³»ç»Ÿé…ç½®)
6. [ç”¨æˆ·ç¯å¢ƒä¸æƒé™é…ç½®](#6-ç”¨æˆ·ç¯å¢ƒä¸æƒé™é…ç½®)
7. [chrootç¯å¢ƒæµ‹è¯•éªŒè¯](#7-chrootç¯å¢ƒæµ‹è¯•éªŒè¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ  chrootåŸºç¡€æ¦‚å¿µä¸ä½œç”¨


### 1.1 ä»€ä¹ˆæ˜¯chroot


ğŸ’­ **ç®€å•ç†è§£**ï¼šchrootå°±åƒç»™ç¨‹åºå»ºé€ ä¸€ä¸ª"å‡çš„æ ¹ç›®å½•"

```
æ­£å¸¸ç³»ç»Ÿï¼šç¨‹åºçœ‹åˆ°çš„æ ¹ç›®å½•æ˜¯çœŸæ­£çš„ /
chrootåï¼šç¨‹åºçœ‹åˆ°çš„æ ¹ç›®å½•å˜æˆäº†ä½ æŒ‡å®šçš„ç›®å½•

ä¸¾ä¸ªä¾‹å­ï¼š
çœŸå®ç³»ç»Ÿæ ¹ç›®å½•: /
chrootç›®å½•: /home/jail
ç¨‹åºåœ¨chrootå: 
- çœ‹ä¸åˆ°çœŸæ­£çš„ /homeã€/etcã€/usr
- åªèƒ½çœ‹åˆ° /home/jail é‡Œé¢çš„å†…å®¹
- /home/jail å°±æ˜¯å®ƒçš„"æ•´ä¸ªä¸–ç•Œ"
```

ğŸ¯ **æ ¸å¿ƒä½œç”¨**ï¼š
- **å®‰å…¨éš”ç¦»**ï¼šé™åˆ¶ç¨‹åºçš„æ–‡ä»¶è®¿é—®èŒƒå›´
- **ç³»ç»Ÿä¿æŠ¤**ï¼šé˜²æ­¢ç¨‹åºè®¿é—®æ•æ„Ÿç³»ç»Ÿæ–‡ä»¶
- **ç¯å¢ƒéš”ç¦»**ï¼šä¸ºç‰¹å®šåº”ç”¨åˆ›å»ºç‹¬ç«‹è¿è¡Œç¯å¢ƒ
- **æ•…éšœéš”ç¦»**ï¼šç¨‹åºå‡ºé—®é¢˜ä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿ

### 1.2 chrootçš„å·¥ä½œåŸç†


ğŸ” **å·¥ä½œæœºåˆ¶å›¾ç¤º**ï¼š
```
æ­£å¸¸æ–‡ä»¶ç³»ç»Ÿè®¿é—®ï¼š
ç¨‹åº â†’ ç³»ç»Ÿè°ƒç”¨ â†’ çœŸå®æ–‡ä»¶ç³»ç»Ÿ â†’ /etc/passwd

chrootåçš„è®¿é—®ï¼š
ç¨‹åº â†’ ç³»ç»Ÿè°ƒç”¨ â†’ chrootç¯å¢ƒ â†’ /jail/etc/passwd
                      â†‘
                   è¢«é™åˆ¶åœ¨è¿™é‡Œ
```

ğŸ·ï¸ **ä¸“ä¸šæœ¯è¯­è§£é‡Š**ï¼š
- **`chrootç›‘ç‹±`**ï¼šè¢«chrooté™åˆ¶çš„ç¯å¢ƒï¼Œç¨‹åºåƒè¢«"å…³"åœ¨é‡Œé¢
- **`æ ¹ç›®å½•é‡å®šå‘`**ï¼šæŠŠç¨‹åºè®¤ä¸ºçš„"/"æ”¹æˆæŒ‡å®šç›®å½•
- **`æ–‡ä»¶ç³»ç»Ÿéš”ç¦»`**ï¼šç¨‹åºåªèƒ½çœ‹åˆ°chrootç¯å¢ƒå†…çš„æ–‡ä»¶

## 2. ğŸ“ chrootç¯å¢ƒç›®å½•ç»“æ„åˆ›å»º


### 2.1 åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„


ğŸ› ï¸ **ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºchrootæ ¹ç›®å½•**

```bash
# åˆ›å»ºchrootç¯å¢ƒçš„æ ¹ç›®å½•
sudo mkdir -p /home/chroot_jail

# ğŸ’¡ ä¸ºä»€ä¹ˆå«jailï¼Ÿå› ä¸ºç¨‹åºè¢«"ç›‘ç¦"åœ¨è¿™ä¸ªç›®å½•é‡Œ
```

ğŸ—ï¸ **ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¿…è¦çš„ç³»ç»Ÿç›®å½•**

```bash
# åˆ›å»ºæ ‡å‡†çš„Linuxç›®å½•ç»“æ„
cd /home/chroot_jail
sudo mkdir -p {bin,lib,lib64,etc,dev,tmp,var,proc,sys,usr/bin,usr/lib}

# ğŸ“‹ ç›®å½•ä½œç”¨è¯´æ˜ï¼š
# bin/     - åŸºæœ¬å‘½ä»¤ç¨‹åº(ls, cat, shç­‰)
# lib/     - 32ä½åŠ¨æ€åº“æ–‡ä»¶
# lib64/   - 64ä½åŠ¨æ€åº“æ–‡ä»¶  
# etc/     - é…ç½®æ–‡ä»¶
# dev/     - è®¾å¤‡æ–‡ä»¶
# tmp/     - ä¸´æ—¶æ–‡ä»¶
# var/     - å¯å˜æ•°æ®æ–‡ä»¶
# proc/    - è¿›ç¨‹ä¿¡æ¯(éœ€è¦æŒ‚è½½)
# sys/     - ç³»ç»Ÿä¿¡æ¯(éœ€è¦æŒ‚è½½)
# usr/bin/ - ç”¨æˆ·ç¨‹åº
# usr/lib/ - ç”¨æˆ·åº“æ–‡ä»¶
```

### 2.2 ç›®å½•æƒé™è®¾ç½®


âš¡ **è®¾ç½®åˆé€‚çš„ç›®å½•æƒé™**ï¼š

```bash
# è®¾ç½®åŸºç¡€ç›®å½•æƒé™
sudo chmod 755 /home/chroot_jail
sudo chmod 755 /home/chroot_jail/{bin,lib,lib64,etc,usr}
sudo chmod 1777 /home/chroot_jail/tmp  # sticky bit for tmp
sudo chmod 755 /home/chroot_jail/{dev,var,proc,sys}

# ğŸ”‘ æƒé™å«ä¹‰ï¼š
# 755: ownerå¯è¯»å†™æ‰§è¡Œï¼Œgroupå’Œotherå¯è¯»æ‰§è¡Œ
# 1777: sticky bit + æ‰€æœ‰ç”¨æˆ·å¯è¯»å†™æ‰§è¡Œ(tmpç›®å½•æ ‡å‡†æƒé™)
```

## 3. ğŸ“¦ ç³»ç»Ÿæ ¸å¿ƒæ–‡ä»¶å¤åˆ¶ä¸é…ç½®


### 3.1 åŸºæœ¬å‘½ä»¤ç¨‹åºå¤åˆ¶


ğŸ”§ **å¤åˆ¶å¸¸ç”¨çš„åŸºæœ¬å‘½ä»¤**ï¼š

```bash
# å¤åˆ¶åŸºç¡€Shell
sudo cp /bin/bash /home/chroot_jail/bin/
sudo cp /bin/sh /home/chroot_jail/bin/

# å¤åˆ¶åŸºæœ¬å‘½ä»¤
sudo cp /bin/{ls,cat,echo,pwd,mkdir,rmdir,rm,cp,mv} /home/chroot_jail/bin/

# å¤åˆ¶æ–‡æœ¬å¤„ç†å‘½ä»¤
sudo cp /usr/bin/{grep,sed,awk,sort,uniq,head,tail,wc} /home/chroot_jail/usr/bin/

# ğŸŒ° ä¸ºä»€ä¹ˆå¤åˆ¶è¿™äº›å‘½ä»¤ï¼Ÿ
# - bash: æä¾›Shellç¯å¢ƒ
# - ls,cat: åŸºæœ¬æ–‡ä»¶æ“ä½œ
# - grep,sed: æ–‡æœ¬å¤„ç†
# - è¿™äº›æ˜¯chrootç¯å¢ƒå†…æœ€åŸºæœ¬çš„æ“ä½œéœ€æ±‚
```

### 3.2 ç³»ç»Ÿé…ç½®æ–‡ä»¶å‡†å¤‡


ğŸ“‹ **å¤åˆ¶å¿…è¦çš„é…ç½®æ–‡ä»¶**ï¼š

```bash
# å¤åˆ¶ç”¨æˆ·å’Œç»„ä¿¡æ¯
sudo cp /etc/{passwd,group,shadow} /home/chroot_jail/etc/

# å¤åˆ¶DNSé…ç½®
sudo cp /etc/{hosts,resolv.conf,nsswitch.conf} /home/chroot_jail/etc/

# å¤åˆ¶æ—¶åŒºä¿¡æ¯
sudo cp -r /etc/localtime /home/chroot_jail/etc/

# ğŸ’¡ è¿™äº›æ–‡ä»¶çš„ä½œç”¨ï¼š
# passwd/group/shadow: ç”¨æˆ·èº«ä»½éªŒè¯
# hosts: æœ¬åœ°ä¸»æœºåè§£æ
# resolv.conf: DNSæœåŠ¡å™¨é…ç½®  
# nsswitch.conf: åç§°æœåŠ¡åˆ‡æ¢é…ç½®
# localtime: ç³»ç»Ÿæ—¶åŒºè®¾ç½®
```

## 4. ğŸ”— åŠ¨æ€åº“ä¾èµ–åˆ†æä¸å¤„ç†


### 4.1 ä½¿ç”¨lddå‘½ä»¤åˆ†æä¾èµ–


ğŸ” **lddå‘½ä»¤è¯¦è§£**ï¼š

ğŸ’­ **ä»€ä¹ˆæ˜¯ldd**ï¼š`ldd`æ˜¯"List Dynamic Dependencies"çš„ç¼©å†™ï¼Œç”¨æ¥æŸ¥çœ‹ç¨‹åºéœ€è¦å“ªäº›åŠ¨æ€åº“

```bash
# æŸ¥çœ‹bashéœ€è¦çš„åŠ¨æ€åº“
ldd /bin/bash

# è¾“å‡ºç¤ºä¾‹ï¼š
# linux-vdso.so.1 (0x00007fff5d7fe000)
# libtinfo.so.5 => /lib/x86_64-linux-gnu/libtinfo.so.5
# libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2  
# libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6
# /lib64/ld-linux-x86-64.so.2
```

ğŸ¯ **ä¾èµ–åˆ†æè„šæœ¬åˆ›å»º**ï¼š

```bash
#!/bin/bash
# copy_dependencies.sh - è‡ªåŠ¨å¤åˆ¶ç¨‹åºä¾èµ–çš„è„šæœ¬

CHROOT_DIR="/home/chroot_jail"
PROGRAM="$1"

if [ -z "$PROGRAM" ]; then
    echo "ç”¨æ³•: $0 <ç¨‹åºè·¯å¾„>"
    exit 1
fi

echo "ğŸ“‹ åˆ†æ $PROGRAM çš„ä¾èµ–åº“..."

# è·å–æ‰€æœ‰ä¾èµ–åº“çš„è·¯å¾„
ldd "$PROGRAM" | grep "=>" | awk '{print $3}' | while read lib; do
    if [ -n "$lib" ] && [ -f "$lib" ]; then
        # è·å–åº“æ–‡ä»¶çš„ç›®å½•ç»“æ„
        lib_dir=$(dirname "$lib")
        chroot_lib_dir="$CHROOT_DIR$lib_dir"
        
        # åˆ›å»ºç›®å½•ç»“æ„
        sudo mkdir -p "$chroot_lib_dir"
        
        # å¤åˆ¶åº“æ–‡ä»¶
        sudo cp "$lib" "$chroot_lib_dir/"
        echo "âœ… å¤åˆ¶: $lib -> $chroot_lib_dir/"
    fi
done

# å¤åˆ¶åŠ¨æ€é“¾æ¥å™¨
ldd "$PROGRAM" | grep "ld-linux" | awk '{print $1}' | while read linker; do
    if [ -f "$linker" ]; then
        linker_dir=$(dirname "$linker")
        sudo mkdir -p "$CHROOT_DIR$linker_dir"
        sudo cp "$linker" "$CHROOT_DIR$linker_dir/"
        echo "âœ… å¤åˆ¶é“¾æ¥å™¨: $linker"
    fi
done

echo "ğŸ‰ ä¾èµ–åˆ†æå’Œå¤åˆ¶å®Œæˆï¼"
```

### 4.2 æ‰¹é‡å¤„ç†ç¨‹åºä¾èµ–


âš¡ **æ‰¹é‡å¤åˆ¶å¤šä¸ªç¨‹åºçš„ä¾èµ–**ï¼š

```bash
# ä¸ºæ‰€æœ‰åŸºæœ¬å‘½ä»¤å¤åˆ¶ä¾èµ–åº“
PROGRAMS=(
    /bin/bash
    /bin/sh
    /bin/ls
    /bin/cat
    /bin/echo
    /usr/bin/grep
)

for prog in "${PROGRAMS[@]}"; do
    echo "ğŸ”„ å¤„ç† $prog çš„ä¾èµ–..."
    ./copy_dependencies.sh "$prog"
done
```

## 5. ğŸ–¥ï¸ è®¾å¤‡æ–‡ä»¶ä¸ç³»ç»Ÿé…ç½®


### 5.1 åˆ›å»ºå¿…è¦çš„è®¾å¤‡æ–‡ä»¶


ğŸ”§ **è®¾å¤‡æ–‡ä»¶åˆ›å»º**ï¼š

ğŸ’­ **ä»€ä¹ˆæ˜¯è®¾å¤‡æ–‡ä»¶**ï¼šåœ¨Linuxä¸­ï¼Œè®¾å¤‡æ–‡ä»¶æ˜¯ä¸ç¡¬ä»¶è®¾å¤‡é€šä¿¡çš„ç‰¹æ®Šæ–‡ä»¶

```bash
# è¿›å…¥chrootç¯å¢ƒçš„devç›®å½•
cd /home/chroot_jail/dev

# åˆ›å»ºnullè®¾å¤‡ - "é»‘æ´"è®¾å¤‡ï¼Œä¸¢å¼ƒæ‰€æœ‰å†™å…¥æ•°æ®
sudo mknod null c 1 3
sudo chmod 666 null

# åˆ›å»ºzeroè®¾å¤‡ - æä¾›æ— é™çš„0å­—èŠ‚
sudo mknod zero c 1 5  
sudo chmod 666 zero

# åˆ›å»ºrandomè®¾å¤‡ - æä¾›éšæœºæ•°
sudo mknod random c 1 8
sudo chmod 666 random
sudo mknod urandom c 1 9
sudo chmod 666 urandom

# åˆ›å»ºæ ‡å‡†è¾“å…¥è¾“å‡ºè®¾å¤‡
sudo mknod stdin c 1 0
sudo mknod stdout c 1 1  
sudo mknod stderr c 1 2

# ğŸ·ï¸ mknodå‘½ä»¤å‚æ•°è¯´æ˜ï¼š
# c: å­—ç¬¦è®¾å¤‡
# 1: ä¸»è®¾å¤‡å·
# 3,5,8ç­‰: æ¬¡è®¾å¤‡å·
```

### 5.2 æŒ‚è½½ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿ


ğŸ”„ **æŒ‚è½½procå’Œsysæ–‡ä»¶ç³»ç»Ÿ**ï¼š

```bash
# æŒ‚è½½procæ–‡ä»¶ç³»ç»Ÿ(è¿›ç¨‹ä¿¡æ¯)
sudo mount -t proc proc /home/chroot_jail/proc

# æŒ‚è½½sysæ–‡ä»¶ç³»ç»Ÿ(ç³»ç»Ÿä¿¡æ¯)  
sudo mount -t sysfs sys /home/chroot_jail/sys

# æŒ‚è½½devptsæ–‡ä»¶ç³»ç»Ÿ(ä¼ªç»ˆç«¯)
sudo mkdir -p /home/chroot_jail/dev/pts
sudo mount -t devpts devpts /home/chroot_jail/dev/pts

# ğŸ’¡ ä¸ºä»€ä¹ˆè¦æŒ‚è½½è¿™äº›ï¼Ÿ
# proc: ç¨‹åºéœ€è¦è¯»å–è¿›ç¨‹ã€å†…å­˜ç­‰ç³»ç»Ÿä¿¡æ¯
# sys: ç¨‹åºéœ€è¦è®¿é—®ç³»ç»Ÿç¡¬ä»¶ä¿¡æ¯
# devpts: æ”¯æŒä¼ªç»ˆç«¯åŠŸèƒ½
```

## 6. ğŸ‘¤ ç”¨æˆ·ç¯å¢ƒä¸æƒé™é…ç½®


### 6.1 é…ç½®ç”¨æˆ·å’Œç»„ä¿¡æ¯


ğŸ“ **åˆ›å»ºä¸“ç”¨çš„ç”¨æˆ·é…ç½®**ï¼š

```bash
# åˆ›å»ºç®€åŒ–çš„passwdæ–‡ä»¶
cat > /home/chroot_jail/etc/passwd << 'EOF'
root:x:0:0:root:/:/bin/bash
nobody:x:65534:65534:nobody:/tmp:/bin/bash
testuser:x:1000:1000:Test User:/tmp:/bin/bash
EOF

# åˆ›å»ºç®€åŒ–çš„groupæ–‡ä»¶  
cat > /home/chroot_jail/etc/group << 'EOF'
root:x:0:
nobody:x:65534:
users:x:1000:testuser
EOF

# è®¾ç½®åˆé€‚çš„æƒé™
sudo chmod 644 /home/chroot_jail/etc/{passwd,group}
```

### 6.2 ç¯å¢ƒå˜é‡é…ç½®


ğŸŒ **è®¾ç½®chrootç¯å¢ƒçš„ç¯å¢ƒå˜é‡**ï¼š

```bash
# åˆ›å»ºåŸºæœ¬çš„ç¯å¢ƒé…ç½®
cat > /home/chroot_jail/etc/environment << 'EOF'
PATH=/bin:/usr/bin
HOME=/tmp
LANG=en_US.UTF-8
SHELL=/bin/bash
EOF

# åˆ›å»ºåŸºæœ¬çš„profileæ–‡ä»¶
cat > /home/chroot_jail/etc/profile << 'EOF'
#!/bin/bash
# chrootç¯å¢ƒçš„åŸºæœ¬é…ç½®

export PATH="/bin:/usr/bin"
export HOME="/tmp"  
export PS1='[chroot] \u@\h:\w\$ '

# è®¾ç½®ä¸€äº›æœ‰ç”¨çš„åˆ«å
alias ll='ls -la'
alias la='ls -A'
alias l='ls -CF'

echo "ğŸ  æ¬¢è¿è¿›å…¥chrootç¯å¢ƒ"
echo "ğŸ“‚ å½“å‰å¯ç”¨å‘½ä»¤: $(ls /bin /usr/bin | wc -l) ä¸ª"
EOF

sudo chmod 644 /home/chroot_jail/etc/{environment,profile}
```

## 7. âœ… chrootç¯å¢ƒæµ‹è¯•éªŒè¯


### 7.1 è¿›å…¥chrootç¯å¢ƒæµ‹è¯•


ğŸ§ª **åŸºæœ¬åŠŸèƒ½æµ‹è¯•**ï¼š

```bash
# è¿›å…¥chrootç¯å¢ƒ
sudo chroot /home/chroot_jail /bin/bash

# åœ¨chrootç¯å¢ƒå†…æµ‹è¯•å„ç§å‘½ä»¤
pwd                    # åº”è¯¥æ˜¾ç¤º /
ls /                   # åªèƒ½çœ‹åˆ°chrootç¯å¢ƒå†…çš„ç›®å½•  
cat /etc/passwd        # æ˜¾ç¤ºchrootç¯å¢ƒçš„ç”¨æˆ·ä¿¡æ¯
echo "æµ‹è¯•è¾“å‡º"         # æµ‹è¯•åŸºæœ¬å‘½ä»¤
ps aux                 # æŸ¥çœ‹è¿›ç¨‹(éœ€è¦procæŒ‚è½½)

# æµ‹è¯•ç¨‹åºæ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œ
grep "root" /etc/passwd
head -n 5 /etc/group
```

### 7.2 åŠŸèƒ½éªŒè¯è„šæœ¬


ğŸ“‹ **åˆ›å»ºè‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬**ï¼š

```bash
#!/bin/bash
# test_chroot.sh - chrootç¯å¢ƒåŠŸèƒ½éªŒè¯

CHROOT_DIR="/home/chroot_jail"

echo "ğŸ” å¼€å§‹éªŒè¯chrootç¯å¢ƒ..."

# æ£€æŸ¥ç›®å½•ç»“æ„
echo "ğŸ“ æ£€æŸ¥ç›®å½•ç»“æ„ï¼š"
for dir in bin lib etc dev tmp var proc sys; do
    if [ -d "$CHROOT_DIR/$dir" ]; then
        echo "  âœ… $dir ç›®å½•å­˜åœ¨"
    else
        echo "  âŒ $dir ç›®å½•ç¼ºå¤±"
    fi
done

# æ£€æŸ¥åŸºæœ¬å‘½ä»¤
echo -e "\nğŸ”§ æ£€æŸ¥åŸºæœ¬å‘½ä»¤ï¼š"
for cmd in bash sh ls cat echo; do
    if [ -x "$CHROOT_DIR/bin/$cmd" ]; then
        echo "  âœ… $cmd å‘½ä»¤å¯ç”¨"
    else
        echo "  âŒ $cmd å‘½ä»¤ç¼ºå¤±"
    fi
done

# æ£€æŸ¥é…ç½®æ–‡ä»¶
echo -e "\nğŸ“ æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š"
for file in passwd group; do
    if [ -f "$CHROOT_DIR/etc/$file" ]; then
        echo "  âœ… /etc/$file å­˜åœ¨"
    else
        echo "  âŒ /etc/$file ç¼ºå¤±" 
    fi
done

# æ£€æŸ¥è®¾å¤‡æ–‡ä»¶
echo -e "\nğŸ–¥ï¸ æ£€æŸ¥è®¾å¤‡æ–‡ä»¶ï¼š"
for dev in null zero random; do
    if [ -c "$CHROOT_DIR/dev/$dev" ]; then
        echo "  âœ… /dev/$dev è®¾å¤‡å­˜åœ¨"
    else
        echo "  âŒ /dev/$dev è®¾å¤‡ç¼ºå¤±"
    fi
done

# æµ‹è¯•chrootç¯å¢ƒ
echo -e "\nğŸ§ª æµ‹è¯•chrootç¯å¢ƒåŸºæœ¬åŠŸèƒ½ï¼š"
sudo chroot "$CHROOT_DIR" /bin/bash -c "
    echo 'âœ… chrootç¯å¢ƒå¯åŠ¨æˆåŠŸ'
    echo 'ğŸ“‚ å½“å‰ç›®å½•:' \$(pwd)
    echo 'ğŸ“‹ æ ¹ç›®å½•å†…å®¹:' \$(ls / | wc -l) 'ä¸ªé¡¹ç›®'
    echo 'ğŸ‘¤ å½“å‰ç”¨æˆ·:' \$(whoami)
"

echo -e "\nğŸ‰ chrootç¯å¢ƒéªŒè¯å®Œæˆï¼"
```

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ chrootæœ¬è´¨ï¼šä¸ºç¨‹åºåˆ›å»ºä¸€ä¸ª"å‡çš„æ ¹ç›®å½•"ç¯å¢ƒ
ğŸ”¸ ç›®å½•ç»“æ„ï¼šå¿…é¡»åŒ…å«binã€libã€etcã€devç­‰æ ‡å‡†ç›®å½•
ğŸ”¸ ä¾èµ–å¤„ç†ï¼šä½¿ç”¨lddåˆ†æå’Œå¤åˆ¶ç¨‹åºæ‰€éœ€çš„åŠ¨æ€åº“
ğŸ”¸ è®¾å¤‡æ–‡ä»¶ï¼šåˆ›å»ºnullã€zeroã€randomç­‰åŸºæœ¬è®¾å¤‡èŠ‚ç‚¹
ğŸ”¸ ç³»ç»ŸæŒ‚è½½ï¼šprocã€sysã€devptsæ–‡ä»¶ç³»ç»Ÿçš„æ­£ç¡®æŒ‚è½½
ğŸ”¸ ç”¨æˆ·é…ç½®ï¼špasswdã€groupç­‰ç”¨æˆ·èº«ä»½æ–‡ä»¶çš„é…ç½®
```

### 8.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ ç›®å½•åˆ›å»ºçš„è¦ç‚¹**
```
å¿…éœ€ç›®å½•ï¼šbinã€libã€lib64ã€etcã€devã€tmpã€varã€procã€sys
æƒé™è®¾ç½®ï¼š755ç”¨äºä¸€èˆ¬ç›®å½•ï¼Œ1777ç”¨äºtmpç›®å½•
ç»“æ„å®Œæ•´ï¼šæ¨¡æ‹ŸçœŸå®Linuxç³»ç»Ÿçš„ç›®å½•ç»“æ„
```

**ğŸ”¹ ä¾èµ–å¤„ç†çš„æŠ€å·§**
```
lddåˆ†æï¼šæŸ¥çœ‹ç¨‹åºçš„åŠ¨æ€åº“ä¾èµ–å…³ç³»
è·¯å¾„å¤åˆ¶ï¼šä¿æŒåº“æ–‡ä»¶çš„åŸå§‹è·¯å¾„ç»“æ„
æ‰¹é‡å¤„ç†ï¼šç¼–å†™è„šæœ¬è‡ªåŠ¨åŒ–å¤„ç†å¤šä¸ªç¨‹åº
é“¾æ¥å™¨ï¼šä¸è¦å¿˜è®°å¤åˆ¶ld-linuxåŠ¨æ€é“¾æ¥å™¨
```

**ğŸ”¹ ç¯å¢ƒé…ç½®çš„é‡ç‚¹**
```
ç”¨æˆ·æ–‡ä»¶ï¼špasswdã€groupã€shadowçš„æ­£ç¡®é…ç½®
ç¯å¢ƒå˜é‡ï¼šPATHã€HOMEç­‰åŸºç¡€ç¯å¢ƒå˜é‡è®¾ç½®
é…ç½®æ–‡ä»¶ï¼šprofileã€environmentç­‰å¯åŠ¨é…ç½®
æƒé™æ§åˆ¶ï¼šç¡®ä¿æ–‡ä»¶æƒé™çš„å®‰å…¨æ€§
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å®‰å…¨åº”ç”¨**ï¼š
- **WebæœåŠ¡éš”ç¦»**ï¼šå°†WebæœåŠ¡å™¨é™åˆ¶åœ¨chrootç¯å¢ƒä¸­
- **FTPæœåŠ¡å™¨**ï¼šé™åˆ¶FTPç”¨æˆ·åªèƒ½è®¿é—®ç‰¹å®šç›®å½•
- **DNSæœåŠ¡**ï¼šå°†bind9ç­‰DNSæœåŠ¡é™åˆ¶åœ¨å®‰å…¨ç¯å¢ƒä¸­

**ğŸ› ï¸ å¼€å‘æµ‹è¯•**ï¼š
- **è½¯ä»¶æµ‹è¯•**ï¼šåœ¨éš”ç¦»ç¯å¢ƒä¸­æµ‹è¯•ç¨‹åºè¡Œä¸º
- **ç³»ç»Ÿç»´æŠ¤**ï¼šåœ¨ä¸å½±å“ä¸»ç³»ç»Ÿçš„æƒ…å†µä¸‹è¿›è¡Œå®éªŒ
- **åº”ç”¨éƒ¨ç½²**ï¼šä¸ºç‰¹å®šåº”ç”¨åˆ›å»ºç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒ

**âš¡ æ•…éšœæ¢å¤**ï¼š
- **ç³»ç»Ÿä¿®å¤**ï¼šå½“ä¸»ç³»ç»Ÿå‡ºé—®é¢˜æ—¶è¿›å…¥chrootä¿®å¤
- **æ•°æ®æ¢å¤**ï¼šåœ¨éš”ç¦»ç¯å¢ƒä¸­è¿›è¡Œæ•æ„Ÿæ•°æ®æ“ä½œ
- **åº”æ€¥å“åº”**ï¼šå¿«é€Ÿåˆ›å»ºä¸´æ—¶çš„å®‰å…¨å·¥ä½œç¯å¢ƒ

### 8.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**ğŸš¨ ä¾èµ–åº“é—®é¢˜**ï¼š
```
é—®é¢˜ï¼šç¨‹åºè¿è¡Œæ—¶æç¤º"library not found"
è§£å†³ï¼šä½¿ç”¨lddé‡æ–°åˆ†æï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–åº“éƒ½å·²å¤åˆ¶
æ³¨æ„ï¼šä¸åŒæ¶æ„(32ä½/64ä½)çš„åº“æ–‡ä»¶è·¯å¾„ä¸åŒ
```

**âš ï¸ è®¾å¤‡æ–‡ä»¶é—®é¢˜**ï¼š
```
é—®é¢˜ï¼šç¨‹åºæ— æ³•æ­£å¸¸è¾“å…¥è¾“å‡º
è§£å†³ï¼šæ£€æŸ¥/devä¸‹çš„è®¾å¤‡æ–‡ä»¶æ˜¯å¦åˆ›å»ºæ­£ç¡®
æ³¨æ„ï¼šè®¾å¤‡æ–‡ä»¶çš„ä¸»æ¬¡è®¾å¤‡å·å¿…é¡»æ­£ç¡®
```

**ğŸ”§ æŒ‚è½½ç‚¹é—®é¢˜**ï¼š
```
é—®é¢˜ï¼šç¨‹åºæ— æ³•è·å–ç³»ç»Ÿä¿¡æ¯
è§£å†³ï¼šç¡®ä¿procã€sysæ–‡ä»¶ç³»ç»Ÿæ­£ç¡®æŒ‚è½½
æ³¨æ„ï¼šé€€å‡ºchrootå‰è®°å¾—å¸è½½è¿™äº›æ–‡ä»¶ç³»ç»Ÿ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- chrootæ˜¯ç³»ç»Ÿéš”ç¦»çš„åŸºç¡€æŠ€æœ¯ï¼Œç†è§£å®ƒä¸ºå®¹å™¨æŠ€æœ¯æ‰“åŸºç¡€
- ç›®å½•ç»“æ„è¦å®Œæ•´ï¼Œä¾èµ–åº“è¦å…¨é¢ï¼Œé…ç½®æ–‡ä»¶è¦æ­£ç¡®
- å®‰å…¨æ€§å’ŒåŠŸèƒ½æ€§éœ€è¦å¹³è¡¡ï¼Œæ—¢è¦é™åˆ¶åˆè¦èƒ½æ­£å¸¸å·¥ä½œ
- å®é™…åº”ç”¨ä¸­chrootå¸¸ä¸å…¶ä»–å®‰å…¨æŠ€æœ¯ç»„åˆä½¿ç”¨