---
title: 9ã€ç½‘ç»œè®¿é—®æ§åˆ¶
---
## ğŸ“š ç›®å½•

1. [ç½‘ç»œè®¿é—®æ§åˆ¶æ¦‚è¿°](#1-ç½‘ç»œè®¿é—®æ§åˆ¶æ¦‚è¿°)
2. [ç½‘ç»œå¥—æ¥å­—æƒé™æ§åˆ¶](#2-ç½‘ç»œå¥—æ¥å­—æƒé™æ§åˆ¶)
3. [ç«¯å£ç»‘å®šæƒé™ç®¡ç†](#3-ç«¯å£ç»‘å®šæƒé™ç®¡ç†)
4. [ç½‘ç»œå‘½åç©ºé—´éš”ç¦»](#4-ç½‘ç»œå‘½åç©ºé—´éš”ç¦»)
5. [é˜²ç«å¢™ç”¨æˆ·çº§è§„åˆ™](#5-é˜²ç«å¢™ç”¨æˆ·çº§è§„åˆ™)
6. [ç½‘ç»œæµé‡ç”¨æˆ·æ ‡è¯†](#6-ç½‘ç»œæµé‡ç”¨æˆ·æ ‡è¯†)
7. [è¿œç¨‹è®¿é—®æƒé™æ§åˆ¶](#7-è¿œç¨‹è®¿é—®æƒé™æ§åˆ¶)
8. [ç½‘ç»œæœåŠ¡ç”¨æˆ·æ˜ å°„](#8-ç½‘ç»œæœåŠ¡ç”¨æˆ·æ˜ å°„)
9. [ç½‘ç»œèµ„æºé…é¢ç®¡ç†](#9-ç½‘ç»œèµ„æºé…é¢ç®¡ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ç½‘ç»œè®¿é—®æ§åˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç½‘ç»œè®¿é—®æ§åˆ¶


**ç®€å•ç†è§£**ï¼šç½‘ç»œè®¿é—®æ§åˆ¶å°±æ˜¯å†³å®š"å“ªä¸ªç”¨æˆ·å¯ä»¥ä½¿ç”¨å“ªäº›ç½‘ç»œèµ„æº"çš„å®‰å…¨æœºåˆ¶ã€‚

```
æ—¥å¸¸ç”Ÿæ´»ç±»æ¯”ï¼š
å®¶åº­ç½‘ç»œ = å°åŒºç®¡ç†
- é—¨å«æ£€æŸ¥èº«ä»½è¯ â†’ ç”¨æˆ·èº«ä»½éªŒè¯
- ä¸åŒç”¨æˆ·è®¿é—®ä¸åŒåŒºåŸŸ â†’ æƒé™åˆ†çº§
- è®¿å®¢éœ€è¦ç™»è®° â†’ è®¿é—®è®°å½•
- é™åˆ¶å¸¦å®½ä½¿ç”¨ â†’ èµ„æºé…é¢

Linuxç½‘ç»œè®¿é—®æ§åˆ¶ï¼š
- æ§åˆ¶ç”¨æˆ·èƒ½åˆ›å»ºå“ªäº›ç½‘ç»œè¿æ¥
- é™åˆ¶ç”¨æˆ·èƒ½ç»‘å®šå“ªäº›ç«¯å£
- éš”ç¦»ä¸åŒç”¨æˆ·çš„ç½‘ç»œç¯å¢ƒ
- è®°å½•å’Œå®¡è®¡ç½‘ç»œæ´»åŠ¨
```

### 1.2 ç½‘ç»œè®¿é—®æ§åˆ¶çš„å±‚æ¬¡


```
ç½‘ç»œè®¿é—®æ§åˆ¶æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    åº”ç”¨å±‚æ§åˆ¶        â”‚ â† æœåŠ¡è®¿é—®æƒé™ã€APIè°ƒç”¨æ§åˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ä¼ è¾“å±‚æ§åˆ¶        â”‚ â† ç«¯å£ç»‘å®šã€è¿æ¥é™åˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ç½‘ç»œå±‚æ§åˆ¶        â”‚ â† IPè¿‡æ»¤ã€è·¯ç”±æ§åˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ•°æ®é“¾è·¯å±‚æ§åˆ¶    â”‚ â† ç½‘å¡è®¿é—®ã€MACè¿‡æ»¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å„å±‚æ§åˆ¶å†…å®¹**ï¼š
- **åº”ç”¨å±‚**ï¼šæ§åˆ¶ç”¨æˆ·èƒ½è®¿é—®å“ªäº›ç½‘ç»œæœåŠ¡
- **ä¼ è¾“å±‚**ï¼šæ§åˆ¶ç”¨æˆ·èƒ½ä½¿ç”¨å“ªäº›ç«¯å£å’Œåè®®
- **ç½‘ç»œå±‚**ï¼šæ§åˆ¶ç”¨æˆ·çš„IPåœ°å€èŒƒå›´å’Œè·¯ç”±æƒé™
- **æ•°æ®é“¾è·¯å±‚**ï¼šæ§åˆ¶ç”¨æˆ·å¯¹ç‰©ç†ç½‘ç»œæ¥å£çš„è®¿é—®

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œè®¿é—®æ§åˆ¶


**å®‰å…¨éœ€æ±‚**ï¼š
```
å¤šç”¨æˆ·ç¯å¢ƒçš„é£é™©ï¼š
Ã— æ™®é€šç”¨æˆ·å¯åŠ¨æ¶æ„æœåŠ¡å ç”¨ç³»ç»Ÿç«¯å£
Ã— ç”¨æˆ·é—´çš„ç½‘ç»œæµé‡äº’ç›¸å¹²æ‰°
Ã— æœªæˆæƒè®¿é—®æ•æ„Ÿç½‘ç»œèµ„æº
Ã— ç½‘ç»œèµ„æºè¢«æ»¥ç”¨å¯¼è‡´ç³»ç»Ÿæ‹¥å¡

ç½‘ç»œè®¿é—®æ§åˆ¶çš„ä»·å€¼ï¼š
âœ“ é˜²æ­¢æƒé™è¶Šç•Œå’Œæ¶æ„è¡Œä¸º
âœ“ å®ç°ç”¨æˆ·é—´çš„ç½‘ç»œéš”ç¦»
âœ“ ä¿æŠ¤ç³»ç»Ÿå…³é”®ç½‘ç»œæœåŠ¡
âœ“ åˆç†åˆ†é…ç½‘ç»œèµ„æº
```

---

## 2. ğŸ”Œ ç½‘ç»œå¥—æ¥å­—æƒé™æ§åˆ¶


### 2.1 å¥—æ¥å­—åŸºç¡€æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å¥—æ¥å­—**ï¼š
å¥—æ¥å­—æ˜¯ç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ï¼Œå°±åƒç”µè¯çš„è¯ç­’ - ç¨‹åºé€šè¿‡å®ƒä¸ç½‘ç»œä¸Šçš„å…¶ä»–ç¨‹åºé€šä¿¡ã€‚

```
å¥—æ¥å­—ç±»å‹ç®€åŒ–ç†è§£ï¼š

TCPå¥—æ¥å­—ï¼ˆå¯é é€šä¿¡ï¼‰ï¼š
ç¨‹åºA â†--å¯é è¿æ¥--â†’ ç¨‹åºB
å°±åƒæ‰“ç”µè¯ï¼Œå»ºç«‹è¿æ¥åå¯ä»¥æŒç»­å¯¹è¯

UDPå¥—æ¥å­—ï¼ˆå¿«é€Ÿé€šä¿¡ï¼‰ï¼š
ç¨‹åºA --â†’æ•°æ®åŒ…--â†’ ç¨‹åºB
å°±åƒå‘çŸ­ä¿¡ï¼Œå‘å‡ºå»å°±å®Œäº‹ï¼Œä¸ä¿è¯åˆ°è¾¾
```

### 2.2 å¥—æ¥å­—æƒé™æœºåˆ¶


**æƒé™æ§åˆ¶åŸç†**ï¼š
```
å¥—æ¥å­—åˆ›å»ºæƒé™æ£€æŸ¥æµç¨‹ï¼š

ç”¨æˆ·ç¨‹åºè¯·æ±‚åˆ›å»ºå¥—æ¥å­—
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥ç”¨æˆ·èº«ä»½     â”‚ â† ç¡®è®¤æ˜¯å“ªä¸ªç”¨æˆ·
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ£€æŸ¥å¥—æ¥å­—ç±»å‹   â”‚ â† æ£€æŸ¥è¯·æ±‚çš„å¥—æ¥å­—ç±»å‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ£€æŸ¥æƒé™ç­–ç•¥     â”‚ â† å¯¹ç…§æƒé™è§„åˆ™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å†³å®šå…è®¸/æ‹’ç»    â”‚ â† ç»™å‡ºæœ€ç»ˆå†³å®š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
     è¿”å›ç»“æœç»™ç¨‹åº
```

### 2.3 å¥—æ¥å­—æƒé™å®è·µ


**æŸ¥çœ‹å½“å‰å¥—æ¥å­—**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œå¥—æ¥å­—åŠå…¶æ‰€å±ç”¨æˆ·
sudo netstat -tuln
# æˆ–ä½¿ç”¨æ›´ç°ä»£çš„å·¥å…·
sudo ss -tuln

# è¾“å‡ºç¤ºä¾‹ï¼š
Proto Recv-Q Send-Q Local Address    Foreign Address  State    User
tcp   0      0      0.0.0.0:22       0.0.0.0:*        LISTEN   root
tcp   0      0      127.0.0.1:3306   0.0.0.0:*        LISTEN   mysql
```

> ğŸ’¡ **ç†è§£è¾“å‡º**ï¼š
> - `0.0.0.0:22` è¡¨ç¤ºSSHæœåŠ¡ç›‘å¬æ‰€æœ‰IPçš„22ç«¯å£
> - `127.0.0.1:3306` è¡¨ç¤ºMySQLåªç›‘å¬æœ¬åœ°3306ç«¯å£
> - `User` åˆ—æ˜¾ç¤ºåˆ›å»ºå¥—æ¥å­—çš„ç”¨æˆ·

**é™åˆ¶å¥—æ¥å­—åˆ›å»º**ï¼š
```bash
# ä½¿ç”¨systemdé™åˆ¶ç”¨æˆ·çš„ç½‘ç»œæƒé™
sudo systemctl edit user-1000.slice

# æ·»åŠ é™åˆ¶é…ç½®
[Slice]
# ç¦æ­¢åˆ›å»ºç½‘ç»œå¥—æ¥å­—
RestrictNetworkInterfaces=lo
# åªå…è®¸æœ¬åœ°ç½‘ç»œæ¥å£
```

---

## 3. ğŸšª ç«¯å£ç»‘å®šæƒé™ç®¡ç†


### 3.1 ç«¯å£æƒé™åŸºç¡€


**ç«¯å£çš„æœ¬è´¨**ï¼š
ç«¯å£å°±åƒå»ºç­‘ç‰©çš„æˆ¿é—´å·ï¼Œç¨‹åºé€šè¿‡ç«¯å£å·æ¥æ ‡è¯†è‡ªå·±æä¾›çš„æœåŠ¡ã€‚

```
ç«¯å£åˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æƒç«¯å£ (0-1023)       â”‚ â† åªæœ‰rootç”¨æˆ·å¯ä»¥ç»‘å®š
â”‚ ä¾‹å¦‚ï¼š22(SSH), 80(HTTP) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ³¨å†Œç«¯å£ (1024-49151)   â”‚ â† æ™®é€šç”¨æˆ·å¯ä»¥ç»‘å®š
â”‚ ä¾‹å¦‚ï¼š3306(MySQL)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŠ¨æ€ç«¯å£ (49152-65535)  â”‚ â† ä¸´æ—¶é€šä¿¡ä½¿ç”¨
â”‚ ç³»ç»Ÿè‡ªåŠ¨åˆ†é…            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç‰¹æƒç«¯å£ä¿æŠ¤æœºåˆ¶


**ä¸ºä»€ä¹ˆè¦ä¿æŠ¤ä½ç«¯å£**ï¼š
```
å®‰å…¨è€ƒè™‘ï¼š
- ç³»ç»ŸæœåŠ¡é€šå¸¸ä½¿ç”¨çŸ¥åç«¯å£(å¦‚SSHçš„22ç«¯å£)
- é˜²æ­¢æ™®é€šç”¨æˆ·ä¼ªé€ ç³»ç»ŸæœåŠ¡
- é¿å…æ¶æ„ç¨‹åºå ç”¨å…³é”®ç«¯å£
```

**ç‰¹æƒç«¯å£ç»‘å®šç¤ºä¾‹**ï¼š
```bash
# æ™®é€šç”¨æˆ·å°è¯•ç»‘å®š80ç«¯å£ï¼ˆä¼šå¤±è´¥ï¼‰
python3 -c "
import socket
s = socket.socket()
s.bind(('0.0.0.0', 80))  # æƒé™æ‹’ç»é”™è¯¯
"

# rootç”¨æˆ·å¯ä»¥ç»‘å®š80ç«¯å£
sudo python3 -c "
import socket
s = socket.socket()
s.bind(('0.0.0.0', 80))  # æˆåŠŸ
s.listen(1)
"
```

### 3.3 ç«¯å£æƒé™ç®¡ç†å·¥å…·


**å…è®¸æ™®é€šç”¨æˆ·ç»‘å®šç‰¹æƒç«¯å£**ï¼š
```bash
# æ–¹æ³•1: ä½¿ç”¨capabilitiesç»™ç¨‹åºç‰¹æ®Šæƒé™
sudo setcap 'cap_net_bind_service=+ep' /usr/bin/python3
# ç°åœ¨pythonç¨‹åºå¯ä»¥ç»‘å®šç‰¹æƒç«¯å£

# æ–¹æ³•2: ä¿®æ”¹ç³»ç»Ÿé…ç½®å…è®¸æ›´ä½çš„ç«¯å£
echo 'net.ipv4.ip_unprivileged_port_start = 80' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

> âš ï¸ **å®‰å…¨æé†’**ï¼š
> é™ä½ç«¯å£ç»‘å®šé™åˆ¶ä¼šå¸¦æ¥å®‰å…¨é£é™©ï¼Œåªåœ¨å¿…è¦æ—¶ä½¿ç”¨ï¼Œå¹¶é…åˆå…¶ä»–å®‰å…¨æªæ–½ã€‚

**ç«¯å£ä½¿ç”¨ç›‘æ§**ï¼š
```bash
# å®æ—¶ç›‘æ§ç«¯å£ç»‘å®šæ´»åŠ¨
sudo ss -tulpn | grep :80
# æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹å ç”¨äº†80ç«¯å£

# æ£€æŸ¥ç«¯å£å†²çª
sudo lsof -i :8080
# è¯¦ç»†æ˜¾ç¤ºä½¿ç”¨8080ç«¯å£çš„ç¨‹åº
```

---

## 4. ğŸ“¦ ç½‘ç»œå‘½åç©ºé—´éš”ç¦»


### 4.1 ç½‘ç»œå‘½åç©ºé—´æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç½‘ç»œå‘½åç©ºé—´**ï¼š
ç½‘ç»œå‘½åç©ºé—´å°±åƒç»™æ¯ä¸ªç”¨æˆ·åˆ†é…ç‹¬ç«‹çš„"ç½‘ç»œç¯å¢ƒ"ï¼Œå°±åƒæ¯å®¶æœ‰è‡ªå·±çš„ç½‘ç»œè®¾ç½®ä¸€æ ·ã€‚

```
ç½‘ç»œå‘½åç©ºé—´éš”ç¦»ç¤ºæ„ï¼š

å…¨å±€ç½‘ç»œå‘½åç©ºé—´ï¼ˆrootï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  eth0: 192.168.1.100            â”‚
â”‚  lo: 127.0.0.1                  â”‚
â”‚  è·¯ç”±è¡¨: é»˜è®¤ç½‘å…³ 192.168.1.1   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·Açš„ç½‘ç»œå‘½åç©ºé—´:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  veth0: 10.0.1.2                â”‚
â”‚  lo: 127.0.0.1                  â”‚
â”‚  è·¯ç”±è¡¨: é»˜è®¤ç½‘å…³ 10.0.1.1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·Bçš„ç½‘ç»œå‘½åç©ºé—´:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  veth1: 10.0.2.2                â”‚
â”‚  lo: 127.0.0.1                  â”‚
â”‚  è·¯ç”±è¡¨: é»˜è®¤ç½‘å…³ 10.0.2.1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç½‘ç»œå‘½åç©ºé—´æ“ä½œ


**åˆ›å»ºå’Œç®¡ç†ç½‘ç»œå‘½åç©ºé—´**ï¼š
```bash
# åˆ›å»ºæ–°çš„ç½‘ç»œå‘½åç©ºé—´
sudo ip netns add user1_net

# æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œå‘½åç©ºé—´
sudo ip netns list

# åœ¨å‘½åç©ºé—´ä¸­æ‰§è¡Œå‘½ä»¤
sudo ip netns exec user1_net bash
# ç°åœ¨ä½ åœ¨user1_netçš„ç½‘ç»œç¯å¢ƒä¸­

# åœ¨å‘½åç©ºé—´ä¸­æŸ¥çœ‹ç½‘ç»œæ¥å£
sudo ip netns exec user1_net ip link show
# åªèƒ½çœ‹åˆ°è¯¥å‘½åç©ºé—´çš„ç½‘ç»œæ¥å£
```

**é…ç½®å‘½åç©ºé—´ç½‘ç»œ**ï¼š
```bash
# åˆ›å»ºè™šæ‹Ÿç½‘ç»œæ¥å£å¯¹
sudo ip link add veth0 type veth peer name veth1

# å°†ä¸€ç«¯ç§»åŠ¨åˆ°å‘½åç©ºé—´
sudo ip link set veth1 netns user1_net

# é…ç½®å‘½åç©ºé—´å†…çš„ç½‘ç»œ
sudo ip netns exec user1_net ip addr add 10.0.1.2/24 dev veth1
sudo ip netns exec user1_net ip link set veth1 up
sudo ip netns exec user1_net ip link set lo up
```

### 4.3 ç”¨æˆ·ç½‘ç»œéš”ç¦»å®è·µ


**ä¸ºç”¨æˆ·åˆ›å»ºéš”ç¦»ç¯å¢ƒ**ï¼š
```bash
#!/bin/bash
# åˆ›å»ºç”¨æˆ·ç½‘ç»œéš”ç¦»è„šæœ¬

USER_NAME="testuser"
NS_NAME="${USER_NAME}_net"

# åˆ›å»ºç½‘ç»œå‘½åç©ºé—´
sudo ip netns add $NS_NAME

# åˆ›å»ºè™šæ‹Ÿç½‘ç»œæ¥å£
sudo ip link add ${NS_NAME}_in type veth peer name ${NS_NAME}_out

# é…ç½®å‘½åç©ºé—´ç½‘ç»œ
sudo ip link set ${NS_NAME}_in netns $NS_NAME
sudo ip netns exec $NS_NAME ip addr add 172.16.1.100/24 dev ${NS_NAME}_in
sudo ip netns exec $NS_NAME ip link set ${NS_NAME}_in up
sudo ip netns exec $NS_NAME ip link set lo up

# é…ç½®ä¸»æœºç«¯ç½‘æ¡¥è¿æ¥
sudo ip link set ${NS_NAME}_out up
sudo brctl addif user_bridge ${NS_NAME}_out
```

---

## 5. ğŸ”¥ é˜²ç«å¢™ç”¨æˆ·çº§è§„åˆ™


### 5.1 é˜²ç«å¢™åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯é˜²ç«å¢™**ï¼š
é˜²ç«å¢™å°±åƒç½‘ç»œä¸–ç•Œçš„å®‰æ£€é—¨ï¼Œæ£€æŸ¥æ¯ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…ï¼Œå†³å®šæ˜¯æ”¾è¡Œè¿˜æ˜¯æ‹¦æˆªã€‚

```
é˜²ç«å¢™å·¥ä½œåŸç†ï¼š

ç½‘ç»œæ•°æ®åŒ… â†’ [é˜²ç«å¢™æ£€æŸ¥] â†’ ç›®æ ‡ç¨‹åº
                   â†‘
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ è§„åˆ™1: å…è®¸ â”‚
            â”‚ è§„åˆ™2: æ‹’ç» â”‚
            â”‚ è§„åˆ™3: è®°å½• â”‚
            â”‚ é»˜è®¤: æ‹’ç»  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 iptablesç”¨æˆ·è§„åˆ™


**åŸºäºç”¨æˆ·IDçš„è¿‡æ»¤è§„åˆ™**ï¼š
```bash
# å…è®¸ç‰¹å®šç”¨æˆ·è®¿é—®ç½‘ç»œ
sudo iptables -A OUTPUT -m owner --uid-owner 1000 -j ACCEPT
# å…è®¸ç”¨æˆ·IDä¸º1000çš„ç”¨æˆ·æ‰€æœ‰ç½‘ç»œè®¿é—®

# é™åˆ¶ç”¨æˆ·åªèƒ½è®¿é—®ç‰¹å®šç«¯å£
sudo iptables -A OUTPUT -m owner --uid-owner 1001 -p tcp --dport 80 -j ACCEPT
sudo iptables -A OUTPUT -m owner --uid-owner 1001 -j DROP
# ç”¨æˆ·1001åªèƒ½è®¿é—®80ç«¯å£ï¼Œå…¶ä»–éƒ½è¢«æ‹’ç»

# é™åˆ¶ç”¨æˆ·çš„ç½‘ç»œå¸¦å®½
sudo iptables -A OUTPUT -m owner --uid-owner 1002 -m limit --limit 10/minute -j ACCEPT
# é™åˆ¶ç”¨æˆ·1002æ¯åˆ†é’Ÿæœ€å¤š10ä¸ªæ•°æ®åŒ…
```

**åŸºäºç”¨æˆ·ç»„çš„è§„åˆ™**ï¼š
```bash
# ä¸ºç”¨æˆ·ç»„è®¾ç½®è§„åˆ™
sudo iptables -A OUTPUT -m owner --gid-owner developers -p tcp --dport 22 -j ACCEPT
# å…è®¸developersç»„è®¿é—®SSH

# ç¦æ­¢æŸç”¨æˆ·ç»„è®¿é—®å¤–ç½‘
sudo iptables -A OUTPUT -m owner --gid-owner restricted -d ! 192.168.0.0/16 -j DROP
# ç¦æ­¢restrictedç»„è®¿é—®å†…ç½‘ä»¥å¤–çš„åœ°å€
```

### 5.3 firewalldç”¨æˆ·ç®¡ç†


**ä½¿ç”¨firewalldç®¡ç†ç”¨æˆ·ç½‘ç»œ**ï¼š
```bash
# ä¸ºç”¨æˆ·åˆ›å»ºä¸“é—¨çš„zone
sudo firewall-cmd --new-zone=user1_zone --permanent
sudo firewall-cmd --reload

# é…ç½®ç”¨æˆ·zoneçš„è§„åˆ™
sudo firewall-cmd --zone=user1_zone --add-port=8080/tcp --permanent
sudo firewall-cmd --zone=user1_zone --add-service=http --permanent

# å°†ç”¨æˆ·çš„ç½‘ç»œæ¥å£ç»‘å®šåˆ°zone
sudo firewall-cmd --zone=user1_zone --add-interface=veth0 --permanent
```

---

## 6. ğŸ·ï¸ ç½‘ç»œæµé‡ç”¨æˆ·æ ‡è¯†


### 6.1 æµé‡æ ‡è¯†åŸç†


**ä¸ºä»€ä¹ˆè¦æ ‡è¯†ç”¨æˆ·æµé‡**ï¼š
```
éœ€æ±‚åœºæ™¯ï¼š
- ç½‘ç»œç›‘æ§ï¼šçŸ¥é“å“ªä¸ªç”¨æˆ·äº§ç”Ÿäº†å¤šå°‘æµé‡
- èµ„æºç®¡ç†ï¼šæŒ‰ç”¨æˆ·é™åˆ¶ç½‘ç»œä½¿ç”¨é‡
- å®‰å…¨å®¡è®¡ï¼šè¿½è¸ªå¯ç–‘ç½‘ç»œæ´»åŠ¨çš„æ¥æº
- è®¡è´¹ç³»ç»Ÿï¼šæŒ‰ç”¨æˆ·ä½¿ç”¨é‡æ”¶è´¹
```

### 6.2 netfilteræµé‡æ ‡è®°


**ä½¿ç”¨iptablesæ ‡è®°ç”¨æˆ·æµé‡**ï¼š
```bash
# ä¸ºä¸åŒç”¨æˆ·çš„æµé‡æ‰“ä¸Šä¸åŒæ ‡è®°
sudo iptables -t mangle -A OUTPUT -m owner --uid-owner 1000 -j MARK --set-mark 100
sudo iptables -t mangle -A OUTPUT -m owner --uid-owner 1001 -j MARK --set-mark 101

# åŸºäºæ ‡è®°è¿›è¡Œæµé‡æ§åˆ¶
sudo iptables -A OUTPUT -m mark --mark 100 -m limit --limit 1mb/s -j ACCEPT
# é™åˆ¶æ ‡è®°ä¸º100çš„æµé‡(ç”¨æˆ·1000)æœ€å¤§1MB/s
```

### 6.3 ç”¨æˆ·æµé‡ç›‘æ§


**ç›‘æ§å·¥å…·é…ç½®**ï¼š
```bash
# å®‰è£…ç½‘ç»œç›‘æ§å·¥å…·
sudo apt install ntopng iftop

# é…ç½®ntopngæŒ‰ç”¨æˆ·æ˜¾ç¤ºæµé‡
sudo ntopng -P /var/ntopng/ntopng.pid -d /var/ntopng -w 3000

# ä½¿ç”¨iftopç›‘æ§å®æ—¶æµé‡
sudo iftop -i eth0
# å¯ä»¥çœ‹åˆ°æ¯ä¸ªè¿æ¥çš„å®æ—¶æµé‡æƒ…å†µ
```

**è‡ªå®šä¹‰æµé‡ç»Ÿè®¡è„šæœ¬**ï¼š
```bash
#!/bin/bash
# ç”¨æˆ·æµé‡ç»Ÿè®¡è„šæœ¬

echo "ç”¨æˆ·ç½‘ç»œæµé‡ç»Ÿè®¡:"
echo "ç”¨æˆ·ID  ç”¨æˆ·å      ä¸Šä¼ (KB)  ä¸‹è½½(KB)"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

for uid in $(awk -F: '{print $3}' /etc/passwd | grep -E '^[0-9]{4}$'); do
    username=$(id -nu $uid)
    # ä»iptablesè·å–ç”¨æˆ·æµé‡ç»Ÿè®¡
    upload=$(sudo iptables -L OUTPUT -v -n | grep "owner UID match $uid" | awk '{print $2}')
    download=$(sudo iptables -L INPUT -v -n | grep "owner UID match $uid" | awk '{print $2}')
    printf "%-6s  %-10s  %-8s  %-8s\n" "$uid" "$username" "$upload" "$download"
done
```

---

## 7. ğŸ” è¿œç¨‹è®¿é—®æƒé™æ§åˆ¶


### 7.1 SSHè®¿é—®æ§åˆ¶


**SSHæ˜¯ä»€ä¹ˆ**ï¼š
SSHæ˜¯å®‰å…¨è¿œç¨‹ç™»å½•å·¥å…·ï¼Œå°±åƒç»™ä½ å®¶é—¨é”é…äº†å¯†é’¥ï¼Œåªæœ‰æœ‰é’¥åŒ™çš„äººæ‰èƒ½è¿›å…¥ã€‚

**åŸºæœ¬SSHè®¿é—®æ§åˆ¶**ï¼š
```bash
# ç¼–è¾‘SSHé…ç½®æ–‡ä»¶
sudo nano /etc/ssh/sshd_config

# é™åˆ¶ç‰¹å®šç”¨æˆ·å¯ä»¥SSHç™»å½•
AllowUsers alice bob charlie

# ç¦æ­¢ç‰¹å®šç”¨æˆ·SSHç™»å½•
DenyUsers mallory eve

# é™åˆ¶ç‰¹å®šç”¨æˆ·ç»„
AllowGroups ssh-users developers
DenyGroups no-ssh restricted

# é‡å¯SSHæœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
sudo systemctl restart sshd
```

### 7.2 åŸºäºå¯†é’¥çš„è®¿é—®æ§åˆ¶


**SSHå¯†é’¥è®¤è¯è®¾ç½®**ï¼š
```bash
# ç”ŸæˆSSHå¯†é’¥å¯¹ï¼ˆåœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼‰
ssh-keygen -t rsa -b 4096 -C "user@example.com"

# å°†å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨
ssh-copy-id username@server_ip

# æˆ–è€…æ‰‹åŠ¨æ·»åŠ å…¬é’¥
mkdir -p ~/.ssh
echo "ssh-rsa AAAAB3N..." >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

**å¼ºåŒ–SSHå®‰å…¨**ï¼š
```bash
# SSHé…ç½®å¼ºåŒ–
PasswordAuthentication no          # ç¦ç”¨å¯†ç è®¤è¯
PubkeyAuthentication yes          # å¯ç”¨å¯†é’¥è®¤è¯
PermitRootLogin no               # ç¦æ­¢rootç›´æ¥ç™»å½•
Port 2222                        # æ›´æ”¹é»˜è®¤ç«¯å£
MaxAuthTries 3                   # é™åˆ¶è®¤è¯å°è¯•æ¬¡æ•°
ClientAliveInterval 300          # è¿æ¥è¶…æ—¶è®¾ç½®
```

### 7.3 ç½‘ç»œä½ç½®è®¿é—®é™åˆ¶


**é™åˆ¶SSHç™»å½•æ¥æº**ï¼š
```bash
# åªå…è®¸ç‰¹å®šIPåœ°å€SSHç™»å½•
sudo iptables -A INPUT -p tcp --dport 22 -s 192.168.1.100 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -j DROP

# å…è®¸ç‰¹å®šç½‘æ®µè®¿é—®
sudo iptables -A INPUT -p tcp --dport 22 -s 10.0.0.0/8 -j ACCEPT

# ä½¿ç”¨TCP Wrappersé™åˆ¶è®¿é—®
echo "sshd: 192.168.1.0/24" | sudo tee -a /etc/hosts.allow
echo "sshd: ALL" | sudo tee -a /etc/hosts.deny
```

---

## 8. ğŸ—ºï¸ ç½‘ç»œæœåŠ¡ç”¨æˆ·æ˜ å°„


### 8.1 æœåŠ¡ç”¨æˆ·æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æœåŠ¡ç”¨æˆ·**ï¼š
æœåŠ¡ç”¨æˆ·æ˜¯ä¸“é—¨ä¸ºç½‘ç»œæœåŠ¡åˆ›å»ºçš„ç³»ç»Ÿè´¦æˆ·ï¼Œå°±åƒç»™æ¯ä¸ªæœåŠ¡åˆ†é…ä¸“é—¨çš„"å·¥ä½œäººå‘˜"ã€‚

```
æœåŠ¡ç”¨æˆ·çš„ä½œç”¨ï¼š

æ™®é€šåšæ³•ï¼ˆä¸å®‰å…¨ï¼‰:
æ‰€æœ‰æœåŠ¡éƒ½ç”¨rootè¿è¡Œ â†’ é£é™©å¤§

å®‰å…¨åšæ³•ï¼ˆæœåŠ¡ç”¨æˆ·ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ApacheæœåŠ¡    â”‚    â”‚   MySQLæœåŠ¡     â”‚    â”‚   RedisæœåŠ¡     â”‚
â”‚   ç”¨æˆ·: www     â”‚    â”‚   ç”¨æˆ·: mysql   â”‚    â”‚   ç”¨æˆ·: redis   â”‚
â”‚   æƒé™: æœ€å°åŒ–   â”‚    â”‚   æƒé™: æœ€å°åŒ–   â”‚    â”‚   æƒé™: æœ€å°åŒ–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 åˆ›å»ºæœåŠ¡ç”¨æˆ·


**åˆ›å»ºä¸“é—¨çš„æœåŠ¡ç”¨æˆ·**ï¼š
```bash
# ä¸ºWebæœåŠ¡åˆ›å»ºç”¨æˆ·
sudo useradd -r -s /bin/false -d /var/www -c "Web Server User" webuser

# ä¸ºæ•°æ®åº“æœåŠ¡åˆ›å»ºç”¨æˆ·
sudo useradd -r -s /bin/false -d /var/lib/mysql -c "MySQL Server" mysql

# å‚æ•°è¯´æ˜ï¼š
# -r: åˆ›å»ºç³»ç»Ÿç”¨æˆ·ï¼ˆUIDå°äº1000ï¼‰
# -s /bin/false: ç¦æ­¢ç™»å½•shell
# -d: æŒ‡å®šhomeç›®å½•
# -c: ç”¨æˆ·æè¿°
```

### 8.3 æœåŠ¡æƒé™é…ç½®


**é…ç½®æœåŠ¡ä»¥æŒ‡å®šç”¨æˆ·è¿è¡Œ**ï¼š
```bash
# Nginxé…ç½®ç¤ºä¾‹
sudo nano /etc/nginx/nginx.conf
# åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šï¼š
user webuser;

# systemdæœåŠ¡é…ç½®
sudo nano /etc/systemd/system/myapp.service
```

**systemdæœåŠ¡é…ç½®ç¤ºä¾‹**ï¼š
```ini
[Unit]
Description=My Web Application
After=network.target

[Service]
Type=simple
User=webuser
Group=webuser
WorkingDirectory=/opt/myapp
ExecStart=/opt/myapp/start.sh
Restart=always

# é¢å¤–å®‰å…¨é™åˆ¶
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/log/myapp

[Install]
WantedBy=multi-user.target
```

---

## 9. ğŸ“Š ç½‘ç»œèµ„æºé…é¢ç®¡ç†


### 9.1 èµ„æºé…é¢æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç½‘ç»œèµ„æºé…é¢**ï¼š
å°±åƒé™åˆ¶æ¯ä¸ªäººçš„ç”¨æ°´é‡ä¸€æ ·ï¼Œç½‘ç»œé…é¢é™åˆ¶æ¯ä¸ªç”¨æˆ·èƒ½ä½¿ç”¨å¤šå°‘ç½‘ç»œèµ„æºã€‚

```
ç½‘ç»œèµ„æºç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¸¦å®½é™åˆ¶      â”‚ â† é™åˆ¶ä¸Šä¼ ä¸‹è½½é€Ÿåº¦
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   è¿æ¥æ•°é™åˆ¶    â”‚ â† é™åˆ¶åŒæ—¶è¿æ¥æ•°é‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æµé‡é™åˆ¶      â”‚ â† é™åˆ¶æ€»æµé‡ä½¿ç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç«¯å£æ•°é™åˆ¶    â”‚ â† é™åˆ¶å¯ç”¨ç«¯å£èŒƒå›´
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 å¸¦å®½é™åˆ¶é…ç½®


**ä½¿ç”¨tc (traffic control) é™åˆ¶å¸¦å®½**ï¼š
```bash
# ä¸ºç”¨æˆ·åˆ›å»ºæµé‡æ§åˆ¶ç±»
sudo tc qdisc add dev eth0 root handle 1: htb default 30

# ä¸ºä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒå¸¦å®½
# ç”¨æˆ·1ï¼šé™åˆ¶2Mbps
sudo tc class add dev eth0 parent 1: classid 1:10 htb rate 2mbit ceil 4mbit
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 handle 100 fw classid 1:10

# ç”¨æˆ·2ï¼šé™åˆ¶1Mbps  
sudo tc class add dev eth0 parent 1: classid 1:20 htb rate 1mbit ceil 2mbit
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 handle 101 fw classid 1:20

# é…åˆiptablesæ ‡è®°ç”¨æˆ·æµé‡
sudo iptables -t mangle -A OUTPUT -m owner --uid-owner 1000 -j MARK --set-mark 100
sudo iptables -t mangle -A OUTPUT -m owner --uid-owner 1001 -j MARK --set-mark 101
```

### 9.3 è¿æ¥æ•°é™åˆ¶


**é™åˆ¶ç”¨æˆ·å¹¶å‘è¿æ¥æ•°**ï¼š
```bash
# ä½¿ç”¨iptablesé™åˆ¶ç”¨æˆ·è¿æ¥æ•°
sudo iptables -A OUTPUT -m owner --uid-owner 1000 -m connlimit --connlimit-above 50 -j DROP
# é™åˆ¶ç”¨æˆ·1000æœ€å¤š50ä¸ªå¹¶å‘è¿æ¥

# é™åˆ¶ç‰¹å®šæœåŠ¡çš„è¿æ¥æ•°
sudo iptables -A OUTPUT -m owner --uid-owner 1001 -p tcp --dport 80 \
    -m connlimit --connlimit-above 10 -j DROP
# é™åˆ¶ç”¨æˆ·1001å¯¹HTTPæœåŠ¡æœ€å¤š10ä¸ªè¿æ¥
```

### 9.4 ç³»ç»Ÿçº§èµ„æºé…é¢


**ä½¿ç”¨systemdé…ç½®ç”¨æˆ·èµ„æºé™åˆ¶**ï¼š
```bash
# ç¼–è¾‘ç”¨æˆ·sliceé…ç½®
sudo mkdir -p /etc/systemd/system/user-1000.slice.d
sudo nano /etc/systemd/system/user-1000.slice.d/override.conf
```

**é…ç½®æ–‡ä»¶å†…å®¹**ï¼š
```ini
[Slice]
# å†…å­˜é™åˆ¶
MemoryMax=1G
MemoryHigh=800M

# CPUé™åˆ¶
CPUQuota=50%

# ç½‘ç»œé™åˆ¶
IPAccounting=true
IPAddressAllow=192.168.1.0/24
IPAddressAllow=127.0.0.1

# ä»»åŠ¡é™åˆ¶  
TasksMax=100
```

**åº”ç”¨é…ç½®**ï¼š
```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# é‡å¯ç”¨æˆ·ä¼šè¯ä»¥åº”ç”¨é™åˆ¶
sudo systemctl restart user-1000.slice
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç½‘ç»œè®¿é—®æ§åˆ¶ï¼šå¤šå±‚æ¬¡çš„ç½‘ç»œå®‰å…¨é˜²æŠ¤ä½“ç³»
ğŸ”¸ å¥—æ¥å­—æƒé™ï¼šæ§åˆ¶ç”¨æˆ·åˆ›å»ºç½‘ç»œè¿æ¥çš„èƒ½åŠ›
ğŸ”¸ ç«¯å£ç»‘å®šï¼šç‰¹æƒç«¯å£ä¿æŠ¤å’Œæƒé™ç®¡ç†
ğŸ”¸ ç½‘ç»œå‘½åç©ºé—´ï¼šä¸ºç”¨æˆ·æä¾›éš”ç¦»çš„ç½‘ç»œç¯å¢ƒ
ğŸ”¸ é˜²ç«å¢™è§„åˆ™ï¼šåŸºäºç”¨æˆ·èº«ä»½çš„ç½‘ç»œè¿‡æ»¤
ğŸ”¸ æµé‡æ ‡è¯†ï¼šè¿½è¸ªå’Œç®¡ç†ç”¨æˆ·ç½‘ç»œä½¿ç”¨
ğŸ”¸ è¿œç¨‹è®¿é—®ï¼šSSHç­‰è¿œç¨‹æœåŠ¡çš„æƒé™æ§åˆ¶
ğŸ”¸ æœåŠ¡æ˜ å°„ï¼šç½‘ç»œæœåŠ¡ä¸ç³»ç»Ÿç”¨æˆ·çš„å¯¹åº”å…³ç³»
ğŸ”¸ èµ„æºé…é¢ï¼šç½‘ç»œèµ„æºçš„åˆç†åˆ†é…å’Œé™åˆ¶
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç½‘ç»œå®‰å…¨çš„å±‚æ¬¡åŒ–é˜²æŠ¤**
```
é˜²æŠ¤ç†å¿µï¼š
- ä¸ä¾èµ–å•ä¸€é˜²æŠ¤æªæ–½
- å¤šå±‚é˜²æŠ¤ç›¸äº’é…åˆ
- æœ€å°æƒé™åŸåˆ™
- æ·±åº¦é˜²å¾¡ç­–ç•¥

å®æ–½è¦ç‚¹ï¼š
ç”¨æˆ·èº«ä»½éªŒè¯ + æƒé™æˆæƒ + è®¿é—®æ§åˆ¶ + æµé‡ç›‘æ§ + å®¡è®¡æ—¥å¿—
```

**ğŸ”¹ ç”¨æˆ·ç½‘ç»œéš”ç¦»çš„é‡è¦æ€§**
```
éš”ç¦»ä»·å€¼ï¼š
- é˜²æ­¢ç”¨æˆ·é—´ç½‘ç»œå†²çª
- é™åˆ¶å®‰å…¨é—®é¢˜æ‰©æ•£èŒƒå›´  
- å®ç°ç²¾ç»†åŒ–èµ„æºç®¡ç†
- æä¾›ä¸ªæ€§åŒ–ç½‘ç»œç¯å¢ƒ

å®ç°æ–¹æ³•ï¼š
å‘½åç©ºé—´éš”ç¦» + é˜²ç«å¢™è§„åˆ™ + èµ„æºé…é¢ + æœåŠ¡ç”¨æˆ·åˆ†ç¦»
```

### 10.3 å®é™…åº”ç”¨åœºæ™¯


**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
- **å¤šç”¨æˆ·æœåŠ¡å™¨**ï¼šæä¾›éš”ç¦»çš„ç½‘ç»œç¯å¢ƒç»™ä¸åŒç”¨æˆ·
- **å¼€å‘æµ‹è¯•ç¯å¢ƒ**ï¼šä¸ºå¼€å‘å›¢é˜Ÿåˆ†é…ç‹¬ç«‹çš„ç½‘ç»œèµ„æº
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šæ¯ä¸ªå®¹å™¨ä½¿ç”¨ç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´
- **å®‰å…¨å®¡è®¡ç³»ç»Ÿ**ï¼šè¿½è¸ªå’Œè®°å½•ç”¨æˆ·çš„ç½‘ç»œæ´»åŠ¨
- **èµ„æºç®¡ç†å¹³å°**ï¼šæŒ‰ç”¨æˆ·æˆ–é¡¹ç›®åˆ†é…ç½‘ç»œå¸¦å®½é…é¢

### 10.4 é…ç½®æœ€ä½³å®è·µ


**ğŸ”§ å®‰å…¨é…ç½®åŸåˆ™**
```
åŸºæœ¬åŸåˆ™ï¼š
âœ“ æœ€å°æƒé™ï¼šåªç»™ç”¨æˆ·å¿…éœ€çš„ç½‘ç»œæƒé™
âœ“ é»˜è®¤æ‹’ç»ï¼šæœªæ˜ç¡®å…è®¸çš„è®¿é—®éƒ½æ‹’ç»
âœ“ åˆ†å±‚é˜²æŠ¤ï¼šä½¿ç”¨å¤šç§å®‰å…¨æœºåˆ¶ç»„åˆ
âœ“ æŒç»­ç›‘æ§ï¼šè®°å½•å’Œåˆ†æç½‘ç»œè®¿é—®è¡Œä¸º
âœ“ å®šæœŸæ›´æ–°ï¼šåŠæ—¶æ›´æ–°å®‰å…¨ç­–ç•¥å’Œè§„åˆ™
```

**ğŸ› ï¸ å®ç”¨é…ç½®æ¨¡æ¿**
```bash
# ç”¨æˆ·ç½‘ç»œæƒé™é…ç½®æ¨¡æ¿
create_user_network_profile() {
    local username=$1
    local uid=$2
    
    # 1. åˆ›å»ºç½‘ç»œå‘½åç©ºé—´
    sudo ip netns add ${username}_net
    
    # 2. é…ç½®é˜²ç«å¢™è§„åˆ™
    sudo iptables -A OUTPUT -m owner --uid-owner $uid \
        -p tcp --dport 80,443 -j ACCEPT
    
    # 3. è®¾ç½®å¸¦å®½é™åˆ¶
    sudo tc class add dev eth0 parent 1: classid 1:$uid \
        htb rate 10mbit ceil 20mbit
    
    # 4. å¯ç”¨æµé‡ç›‘æ§
    sudo iptables -t mangle -A OUTPUT -m owner --uid-owner $uid \
        -j MARK --set-mark $uid
}
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç½‘ç»œè®¿é—®æ§åˆ¶æ˜¯å¤šç”¨æˆ·ç³»ç»Ÿçš„é‡è¦å®‰å…¨æœºåˆ¶
- é€šè¿‡ç”¨æˆ·èº«ä»½è¯†åˆ«å®ç°ç²¾ç»†åŒ–ç½‘ç»œæƒé™ç®¡ç†
- ç½‘ç»œå‘½åç©ºé—´æä¾›ç”¨æˆ·çº§åˆ«çš„ç½‘ç»œéš”ç¦»
- é˜²ç«å¢™è§„åˆ™æ”¯æŒåŸºäºç”¨æˆ·çš„æµé‡è¿‡æ»¤
- èµ„æºé…é¢ç¡®ä¿ç½‘ç»œèµ„æºçš„å…¬å¹³ä½¿ç”¨
- æŒç»­ç›‘æ§å’Œå®¡è®¡æ˜¯ç½‘ç»œå®‰å…¨çš„é‡è¦ç¯èŠ‚