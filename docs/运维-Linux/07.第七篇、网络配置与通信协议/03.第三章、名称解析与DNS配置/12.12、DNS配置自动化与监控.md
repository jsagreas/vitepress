---
title: 12ã€DNSé…ç½®è‡ªåŠ¨åŒ–ä¸ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [DNSè‡ªåŠ¨åŒ–é…ç½®æ¦‚è¿°](#1-dnsè‡ªåŠ¨åŒ–é…ç½®æ¦‚è¿°)
2. [Ansibleè‡ªåŠ¨åŒ–DNSé…ç½®](#2-ansibleè‡ªåŠ¨åŒ–dnsé…ç½®)
3. [DNSé…ç½®æ¨¡æ¿åŒ–ç®¡ç†](#3-dnsé…ç½®æ¨¡æ¿åŒ–ç®¡ç†)
4. [DNSè§£ææ€§èƒ½ç›‘æ§](#4-dnsè§£ææ€§èƒ½ç›‘æ§)
5. [åŸŸåè§£ææœåŠ¡å¯ç”¨æ€§ç›‘æ§](#5-åŸŸåè§£ææœåŠ¡å¯ç”¨æ€§ç›‘æ§)
6. [DNSé…ç½®å˜æ›´ç®¡ç†](#6-dnsé…ç½®å˜æ›´ç®¡ç†)
7. [æ‰¹é‡DNSé…ç½®éƒ¨ç½²](#7-æ‰¹é‡dnsé…ç½®éƒ¨ç½²)
8. [DNSæœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬](#8-dnsæœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ DNSè‡ªåŠ¨åŒ–é…ç½®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯DNSè‡ªåŠ¨åŒ–é…ç½®


**ç®€å•ç†è§£**ï¼šDNSè‡ªåŠ¨åŒ–é…ç½®å°±åƒæ˜¯ç»™DNSæœåŠ¡å™¨é…å¤‡äº†ä¸€ä¸ª"ç®¡å®¶"ï¼Œè¿™ä¸ªç®¡å®¶èƒ½å¤ŸæŒ‰ç…§æˆ‘ä»¬é¢„è®¾çš„è§„åˆ™ï¼Œè‡ªåŠ¨å®ŒæˆDNSæœåŠ¡å™¨çš„å®‰è£…ã€é…ç½®ã€æ›´æ–°ç­‰å·¥ä½œï¼Œæ— éœ€æˆ‘ä»¬æ¯æ¬¡éƒ½æ‰‹åŠ¨æ“ä½œã€‚

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒå®¶é‡Œçš„æ´—è¡£æœºï¼Œä½ åªéœ€è¦æŠŠè„è¡£æœæ”¾è¿›å»ï¼Œé€‰æ‹©æ´—è¡£æ¨¡å¼ï¼Œå‰©ä¸‹çš„æ¸…æ´—ã€æ¼‚æ´—ã€è„±æ°´éƒ½è‡ªåŠ¨å®Œæˆã€‚DNSè‡ªåŠ¨åŒ–ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬è®¾å®šå¥½è§„åˆ™ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œé…ç½®ä»»åŠ¡ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦DNSè‡ªåŠ¨åŒ–ï¼Ÿ**

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ‰‹åŠ¨é…ç½® vs è‡ªåŠ¨åŒ–é…ç½®            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰‹åŠ¨é…ç½®é—®é¢˜     â”‚ è‡ªåŠ¨åŒ–é…ç½®ä¼˜åŠ¿         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å®¹æ˜“å‡ºé”™       â”‚ â€¢ æ ‡å‡†åŒ–é…ç½®          â”‚
â”‚ â€¢ æ•ˆç‡ä½ä¸‹       â”‚ â€¢ æ‰¹é‡å¤„ç†èƒ½åŠ›        â”‚
â”‚ â€¢ ä¸æ˜“é‡å¤       â”‚ â€¢ ç‰ˆæœ¬æ§åˆ¶           â”‚
â”‚ â€¢ éš¾ä»¥å®¡è®¡       â”‚ â€¢ å¿«é€Ÿæ¢å¤           â”‚
â”‚ â€¢ äººå·¥æˆæœ¬é«˜     â”‚ â€¢ é™ä½è¿ç»´æˆæœ¬        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 1.2 DNSè‡ªåŠ¨åŒ–çš„æ ¸å¿ƒç»„ä»¶


**è‡ªåŠ¨åŒ–å·¥å…·é“¾æ¶æ„**ï¼š

```
é…ç½®ç®¡ç†å±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ansible     â”‚ Puppet      â”‚ Chef        â”‚
â”‚ (ä¸»æµé€‰æ‹©)   â”‚ (ä¼ä¸šçº§)     â”‚ (Rubyç”Ÿæ€)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æ¨¡æ¿å¼•æ“å±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Jinja2      â”‚ ERB         â”‚ è‡ªå®šä¹‰æ¨¡æ¿   â”‚
â”‚ (Ansible)   â”‚ (Puppet)    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç›‘æ§åé¦ˆå±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prometheus  â”‚ Nagios      â”‚ Zabbix      â”‚
â”‚ (ç°ä»£åŒ–)     â”‚ (ä¼ ç»Ÿ)       â”‚ (ä¼ä¸šçº§)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”§ Ansibleè‡ªåŠ¨åŒ–DNSé…ç½®


### 2.1 AnsibleåŸºç¡€æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯Ansibleï¼Ÿ**

Ansibleæ˜¯ä¸€ä¸ª**æ— ä»£ç†**çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå°±åƒæ˜¯ä¸€ä¸ª"é¥æ§å™¨"ï¼Œå¯ä»¥è¿œç¨‹æ§åˆ¶å¤šå°æœåŠ¡å™¨åŒæ—¶æ‰§è¡Œä»»åŠ¡ã€‚

> ğŸ¯ **æ ¸å¿ƒç†è§£**  
> Ansible = SSH + è„šæœ¬ + æ¨¡æ¿åŒ–ï¼Œå®ƒé€šè¿‡SSHè¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œæ‰§è¡Œé¢„å®šä¹‰çš„ä»»åŠ¡è„šæœ¬ã€‚

**Ansibleçš„å·¥ä½œåŸç†**ï¼š

```
æ§åˆ¶èŠ‚ç‚¹(Ansible)                  ç›®æ ‡æœåŠ¡å™¨ç¾¤
        â”‚                              â”‚
        â”‚ â”€â”€â”€â”€ SSHè¿æ¥ â”€â”€â”€â”€â†’            â”‚
        â”‚                              â”‚
    Playbook                      æ‰§è¡Œä»»åŠ¡
    (å‰§æœ¬æ–‡ä»¶)                   â”œâ”€ DNSæœåŠ¡å™¨1
        â”‚                       â”œâ”€ DNSæœåŠ¡å™¨2
    åŒ…å«ä»»åŠ¡æ¸…å•                 â””â”€ DNSæœåŠ¡å™¨3
```

### 2.2 DNSæœåŠ¡å™¨è‡ªåŠ¨åŒ–å®‰è£…


**åŸºç¡€DNSæœåŠ¡å™¨å®‰è£…å‰§æœ¬**ï¼š

```yaml
---
- name: è‡ªåŠ¨åŒ–å®‰è£…é…ç½®DNSæœåŠ¡å™¨
  hosts: dns_servers
  become: yes
  
  vars:
    dns_package: bind9        # Ubuntu/Debian
    # dns_package: named      # CentOS/RHEL
    
  tasks:
    - name: æ›´æ–°è½¯ä»¶åŒ…ç¼“å­˜
      apt:
        update_cache: yes
      when: ansible_os_family == "Debian"
    
    - name: å®‰è£…DNSæœåŠ¡å™¨è½¯ä»¶
      package:
        name: "{{ dns_package }}"
        state: present
    
    - name: å¯åŠ¨å¹¶è®¾ç½®DNSæœåŠ¡å¼€æœºè‡ªå¯
      systemd:
        name: "{{ dns_package }}"
        state: started
        enabled: yes
```

> ğŸ“‹ **ä»»åŠ¡è§£è¯»**  
> - `hosts: dns_servers`ï¼šæŒ‡å®šè¦æ“ä½œçš„æœåŠ¡å™¨ç»„
> - `become: yes`ï¼šä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œ
> - `vars`ï¼šå®šä¹‰å˜é‡ï¼Œä¾¿äºä¸åŒç³»ç»Ÿå¤ç”¨
> - `tasks`ï¼šå…·ä½“è¦æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨

### 2.3 DNSé…ç½®æ–‡ä»¶è‡ªåŠ¨åŒ–ç®¡ç†


**ä¸»é…ç½®æ–‡ä»¶æ¨¡æ¿åŒ–**ï¼š

```yaml
- name: éƒ¨ç½²DNSä¸»é…ç½®æ–‡ä»¶
  template:
    src: named.conf.j2
    dest: /etc/bind/named.conf
    backup: yes
    owner: root
    group: bind
    mode: '0644'
  notify: é‡å¯DNSæœåŠ¡

- name: éƒ¨ç½²åŒºåŸŸé…ç½®æ–‡ä»¶
  template:
    src: db.example.com.j2
    dest: "/etc/bind/db.{{ item.domain }}"
    owner: root
    group: bind
    mode: '0644'
  loop: "{{ dns_zones }}"
  notify: é‡è½½DNSé…ç½®
```

**é…ç½®æ¨¡æ¿ç¤ºä¾‹** (named.conf.j2)ï¼š

```jinja2
// DNSæœåŠ¡å™¨ä¸»é…ç½®æ–‡ä»¶
// ç”±Ansibleè‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹

options {
    directory "/var/cache/bind";
    
    // ç›‘å¬åœ°å€
    listen-on { 
        127.0.0.1; 
        {% for ip in ansible_all_ipv4_addresses %}
        {{ ip }};
        {% endfor %}
    };
    
    // å…è®¸æŸ¥è¯¢çš„å®¢æˆ·ç«¯
    allow-query { 
        {% for network in allowed_networks %}
        {{ network }};
        {% endfor %}
    };
    
    // é€’å½’æŸ¥è¯¢è®¾ç½®
    recursion {{ 'yes' if enable_recursion else 'no' }};
    
    // è½¬å‘å™¨é…ç½®
    {% if forwarders %}
    forwarders {
        {% for forwarder in forwarders %}
        {{ forwarder }};
        {% endfor %}
    };
    {% endif %}
};

// åŒºåŸŸé…ç½®
{% for zone in dns_zones %}
zone "{{ zone.domain }}" {
    type {{ zone.type }};
    file "/etc/bind/db.{{ zone.domain }}";
    {% if zone.type == 'slave' %}
    masters { {{ zone.master }}; };
    {% endif %}
};
{% endfor %}
```

### 2.4 å˜é‡é…ç½®ä¸ç¯å¢ƒç®¡ç†


**ä¸»æœºæ¸…å•æ–‡ä»¶** (inventory.yml)ï¼š

```yaml
dns_servers:
  hosts:
    dns-master:
      ansible_host: 192.168.1.10
      server_role: master
    dns-slave1:
      ansible_host: 192.168.1.11
      server_role: slave
    dns-slave2:
      ansible_host: 192.168.1.12
      server_role: slave
      
  vars:
    # é€šç”¨DNSé…ç½®
    allowed_networks:
      - "192.168.1.0/24"
      - "10.0.0.0/8"
    
    forwarders:
      - "8.8.8.8"
      - "8.8.4.4"
    
    enable_recursion: true
    
    # åŒºåŸŸé…ç½®
    dns_zones:
      - domain: "example.com"
        type: "master"
      - domain: "internal.local"
        type: "master"
```

---

## 3. ğŸ“‹ DNSé…ç½®æ¨¡æ¿åŒ–ç®¡ç†


### 3.1 æ¨¡æ¿åŒ–ç®¡ç†çš„æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ¨¡æ¿åŒ–ç®¡ç†ï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹åˆ¶ä½œé¥¼å¹²çš„æ¨¡å…·ï¼Œä½ æœ‰ä¸€ä¸ªå›ºå®šçš„å½¢çŠ¶ï¼Œä½†å¯ä»¥ç”¨ä¸åŒçš„ææ–™ï¼ˆé¢ç²‰ç§ç±»ã€è°ƒæ–™ç­‰ï¼‰åˆ¶ä½œå‡ºä¸åŒå£å‘³çš„é¥¼å¹²ã€‚DNSæ¨¡æ¿åŒ–ç®¡ç†ä¹Ÿæ˜¯è¿™ä¸ªé“ç†ï¼Œæˆ‘ä»¬æœ‰å›ºå®šçš„é…ç½®æ¡†æ¶ï¼Œä½†å¯ä»¥æ ¹æ®ä¸åŒç¯å¢ƒå¡«å…¥ä¸åŒçš„å‚æ•°å€¼ã€‚

**æ¨¡æ¿åŒ–çš„å¥½å¤„**ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                æ¨¡æ¿åŒ–ä¼˜åŠ¿                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ ‡å‡†åŒ–é…ç½®     â”‚ æ‰€æœ‰æœåŠ¡å™¨ä½¿ç”¨ç»Ÿä¸€æ ¼å¼     â”‚
â”‚ å‚æ•°åŒ–å®šåˆ¶     â”‚ ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒå‚æ•°å€¼     â”‚
â”‚ ç‰ˆæœ¬æ§åˆ¶       â”‚ é…ç½®å˜æ›´å¯è¿½è¸ªå¯å›æ»š       â”‚
â”‚ æ‰¹é‡æ›´æ–°       â”‚ ä¸€æ¬¡ä¿®æ”¹å½±å“æ‰€æœ‰æœåŠ¡å™¨     â”‚
â”‚ å‡å°‘é”™è¯¯       â”‚ é¿å…æ‰‹åŠ¨é…ç½®çš„æ‹¼å†™é”™è¯¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 3.2 åŒºåŸŸæ–‡ä»¶æ¨¡æ¿è®¾è®¡


**æ­£å‘è§£æåŒºåŸŸæ¨¡æ¿** (db.zone.j2)ï¼š

```jinja2
;; {{ zone_name }} åŒºåŸŸæ–‡ä»¶
;; ç”±Ansibleè‡ªåŠ¨ç”Ÿæˆäº {{ ansible_date_time.iso8601 }}

$TTL {{ default_ttl | default('86400') }}
@   IN  SOA {{ primary_ns }}.{{ zone_name }}. {{ admin_email | replace('@', '.') }}.{{ zone_name }}. (
        {{ serial | default(ansible_date_time.epoch) }}  ; åºåˆ—å·
        {{ refresh | default('3600') }}                  ; åˆ·æ–°æ—¶é—´
        {{ retry | default('1800') }}                    ; é‡è¯•æ—¶é—´
        {{ expire | default('604800') }}                 ; è¿‡æœŸæ—¶é—´
        {{ minimum | default('86400') }}                 ; æœ€å°TTL
        )

; åç§°æœåŠ¡å™¨è®°å½•
{% for ns in name_servers %}
@   IN  NS  {{ ns }}.{{ zone_name }}.
{% endfor %}

; Aè®°å½•
{% for record in a_records %}
{{ record.name | ljust(20) }} IN  A     {{ record.ip }}
{% endfor %}

; CNAMEè®°å½•
{% for record in cname_records %}
{{ record.name | ljust(20) }} IN  CNAME {{ record.target }}.{{ zone_name }}.
{% endfor %}

; MXè®°å½•
{% for record in mx_records %}
@   IN  MX  {{ record.priority }}  {{ record.server }}.{{ zone_name }}.
{% endfor %}
```

**åå‘è§£æåŒºåŸŸæ¨¡æ¿** (db.reverse.j2)ï¼š

```jinja2
;; {{ network }} åå‘è§£æåŒºåŸŸ
;; è‡ªåŠ¨ç”Ÿæˆæ—¶é—´: {{ ansible_date_time.iso8601 }}

$TTL {{ default_ttl | default('86400') }}
@   IN  SOA {{ primary_ns }}.{{ zone_name }}. {{ admin_email | replace('@', '.') }}.{{ zone_name }}. (
        {{ serial | default(ansible_date_time.epoch) }}
        3600
        1800
        604800
        86400
        )

; åç§°æœåŠ¡å™¨
@   IN  NS  {{ primary_ns }}.{{ zone_name }}.

; PTRè®°å½•
{% for record in ptr_records %}
{{ record.last_octet }}  IN  PTR  {{ record.hostname }}.{{ zone_name }}.
{% endfor %}
```

### 3.3 ç¯å¢ƒç‰¹å®šé…ç½®


**å¼€å‘ç¯å¢ƒé…ç½®** (group_vars/development.yml)ï¼š

```yaml
# å¼€å‘ç¯å¢ƒDNSé…ç½®
environment: development

dns_zones:
  - domain: "dev.example.com"
    type: "master"
    primary_ns: "ns1"
    admin_email: "admin@example.com"
    
    a_records:
      - { name: "web", ip: "192.168.10.100" }
      - { name: "api", ip: "192.168.10.101" }
      - { name: "db", ip: "192.168.10.102" }
    
    cname_records:
      - { name: "www", target: "web" }
      - { name: "app", target: "api" }

# å¼€å‘ç¯å¢ƒè¾ƒçŸ­çš„TTLï¼Œä¾¿äºæµ‹è¯•
default_ttl: 300
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®** (group_vars/production.yml)ï¼š

```yaml
# ç”Ÿäº§ç¯å¢ƒDNSé…ç½®
environment: production

dns_zones:
  - domain: "example.com"
    type: "master"
    primary_ns: "ns1"
    admin_email: "hostmaster@example.com"
    
    a_records:
      - { name: "web1", ip: "203.0.113.100" }
      - { name: "web2", ip: "203.0.113.101" }
      - { name: "api", ip: "203.0.113.110" }
      - { name: "mail", ip: "203.0.113.120" }
    
    cname_records:
      - { name: "www", target: "web1" }
    
    mx_records:
      - { priority: 10, server: "mail" }

# ç”Ÿäº§ç¯å¢ƒè¾ƒé•¿çš„TTLï¼Œå‡å°‘æŸ¥è¯¢è´Ÿè½½
default_ttl: 3600
```

---

## 4. ğŸ“Š DNSè§£ææ€§èƒ½ç›‘æ§


### 4.1 DNSæ€§èƒ½ç›‘æ§çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆè¦ç›‘æ§DNSæ€§èƒ½ï¼Ÿ**

DNSå°±åƒäº’è”ç½‘çš„"ç”µè¯ç°¿"ï¼Œå¦‚æœæŸ¥æ‰¾é€Ÿåº¦æ…¢æˆ–è€…æ‰¾ä¸åˆ°ï¼Œä¼šç›´æ¥å½±å“ç”¨æˆ·è®¿é—®ç½‘ç«™çš„é€Ÿåº¦ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æ‰“ç”µè¯æ—¶ç”µè¯ç°¿ç¿»åŠå¤©æ‰èƒ½æ‰¾åˆ°å·ç ï¼Œè¿™é€šè¯ä½“éªŒè‚¯å®šå¾ˆç³Ÿç³•ã€‚

**DNSæ€§èƒ½å…³é”®æŒ‡æ ‡**ï¼š

```
DNSæ€§èƒ½ç›‘æ§é‡‘å­—å¡”
        â–²
       â•± â•²
      â•±ç”¨æˆ·â•²         æœ€ç»ˆç”¨æˆ·æ„Ÿå—åˆ°çš„è§£æå»¶è¿Ÿ
     â•±ä½“éªŒå±‚â•²
    â•±_______â•²
   â•±         â•²
  â•±  åº”ç”¨å±‚   â•²      åº”ç”¨ç¨‹åºDNSæŸ¥è¯¢æ€§èƒ½
 â•±___________â•²
â•±             â•²
â•±   æœåŠ¡å™¨å±‚   â•²     DNSæœåŠ¡å™¨å“åº”æ—¶é—´å’Œèµ„æºä½¿ç”¨
â•±_____________â•²
â•±               â•²
â•±    ç½‘ç»œå±‚     â•²    ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…ç‡
â•±_______________â•²
```

### 4.2 ä½¿ç”¨digå‘½ä»¤è¿›è¡Œæ€§èƒ½æµ‹è¯•


**åŸºç¡€æ€§èƒ½æµ‹è¯•å‘½ä»¤**ï¼š

```bash
# æµ‹è¯•è§£ææ—¶é—´
dig @8.8.8.8 example.com +stats

# æ‰¹é‡æµ‹è¯•è„šæœ¬
#!/bin/bash
# dns_performance_test.sh

DOMAIN="example.com"
DNS_SERVERS=("8.8.8.8" "1.1.1.1" "208.67.222.222")
LOGFILE="/var/log/dns_performance.log"

echo "DNSæ€§èƒ½æµ‹è¯•å¼€å§‹: $(date)" >> $LOGFILE

for dns in "${DNS_SERVERS[@]}"; do
    echo "æµ‹è¯•DNSæœåŠ¡å™¨: $dns" >> $LOGFILE
    
    # æ‰§è¡Œ5æ¬¡æŸ¥è¯¢å–å¹³å‡å€¼
    total_time=0
    for i in {1..5}; do
        result=$(dig @$dns $DOMAIN +stats | grep "Query time")
        time=$(echo $result | awk '{print $4}')
        total_time=$((total_time + time))
    done
    
    avg_time=$((total_time / 5))
    echo "å¹³å‡æŸ¥è¯¢æ—¶é—´: ${avg_time}ms" >> $LOGFILE
    echo "---" >> $LOGFILE
done
```

### 4.3 Prometheusç›‘æ§é›†æˆ


**DNSæ€§èƒ½å¯¼å‡ºå™¨é…ç½®**ï¼š

```yaml
# prometheus.yml é…ç½®ç‰‡æ®µ
- job_name: 'dns-performance'
  static_configs:
    - targets: ['localhost:9153']  # DNSå¯¼å‡ºå™¨ç«¯å£
  scrape_interval: 30s
  
  params:
    module: [dns_query]
    target: [example.com]
```

**è‡ªå®šä¹‰DNSç›‘æ§è„šæœ¬**ï¼š

```bash
#!/bin/bash
# dns_metrics_collector.sh
# æ”¶é›†DNSæ€§èƒ½æŒ‡æ ‡ä¾›Prometheusä½¿ç”¨

METRICS_FILE="/var/lib/node_exporter/textfile_collector/dns_metrics.prom"

# æµ‹è¯•æœ¬åœ°DNSè§£æ
test_local_dns() {
    local domain=$1
    local start_time=$(date +%s%N)
    
    if dig +short $domain > /dev/null 2>&1; then
        local end_time=$(date +%s%N)
        local duration=$(( (end_time - start_time) / 1000000 ))  # è½¬æ¢ä¸ºæ¯«ç§’
        echo "dns_query_duration_ms{domain=\"$domain\",server=\"local\"} $duration"
    else
        echo "dns_query_success{domain=\"$domain\",server=\"local\"} 0"
    fi
}

# ç”ŸæˆæŒ‡æ ‡
{
    echo "# HELP dns_query_duration_ms DNSæŸ¥è¯¢å“åº”æ—¶é—´(æ¯«ç§’)"
    echo "# TYPE dns_query_duration_ms gauge"
    
    test_local_dns "example.com"
    test_local_dns "google.com"
    
    echo "# HELP dns_service_status DNSæœåŠ¡çŠ¶æ€"
    echo "# TYPE dns_service_status gauge"
    
    if systemctl is-active --quiet named; then
        echo "dns_service_status{service=\"named\"} 1"
    else
        echo "dns_service_status{service=\"named\"} 0"
    fi
    
} > $METRICS_FILE
```

---

## 5. ğŸ” åŸŸåè§£ææœåŠ¡å¯ç”¨æ€§ç›‘æ§


### 5.1 å¯ç”¨æ€§ç›‘æ§ç­–ç•¥


**ä»€ä¹ˆæ˜¯DNSå¯ç”¨æ€§ï¼Ÿ**

DNSå¯ç”¨æ€§å°±æ˜¯DNSæœåŠ¡èƒ½å¦æ­£å¸¸å“åº”æŸ¥è¯¢è¯·æ±‚ã€‚å°±åƒå•†åº—çš„è¥ä¸šçŠ¶æ€ï¼Œè¦ç›‘æ§çš„æ˜¯ï¼š
- **æ˜¯å¦å¼€é—¨**ï¼ˆæœåŠ¡æ˜¯å¦è¿è¡Œï¼‰
- **æ˜¯å¦æœ‰äººæ¥å¾…**ï¼ˆæ˜¯å¦å“åº”æŸ¥è¯¢ï¼‰
- **æœåŠ¡è´¨é‡å¦‚ä½•**ï¼ˆå“åº”é€Ÿåº¦å’Œå‡†ç¡®æ€§ï¼‰

**ç›‘æ§å±‚æ¬¡ç»“æ„**ï¼š

```
DNSå¯ç”¨æ€§ç›‘æ§ä½“ç³»
â”œâ”€â”€ æœåŠ¡å±‚ç›‘æ§
â”‚   â”œâ”€â”€ è¿›ç¨‹çŠ¶æ€æ£€æŸ¥
â”‚   â”œâ”€â”€ ç«¯å£è¿é€šæ€§æµ‹è¯•
â”‚   â””â”€â”€ æœåŠ¡å“åº”æ£€æŸ¥
â”œâ”€â”€ åŠŸèƒ½å±‚ç›‘æ§  
â”‚   â”œâ”€â”€ è§£ææ­£ç¡®æ€§éªŒè¯
â”‚   â”œâ”€â”€ é€’å½’æŸ¥è¯¢æµ‹è¯•
â”‚   â””â”€â”€ åŒºåŸŸä¼ è¾“æ£€æŸ¥
â””â”€â”€ ç”¨æˆ·å±‚ç›‘æ§
    â”œâ”€â”€ ç«¯åˆ°ç«¯è§£ææµ‹è¯•
    â”œâ”€â”€ ä¸åŒåœ°ç†ä½ç½®æµ‹è¯•
    â””â”€â”€ å®¢æˆ·ç«¯æ„ŸçŸ¥å»¶è¿Ÿ
```

### 5.2 Nagiosç›‘æ§é…ç½®


**DNSæœåŠ¡æ£€æŸ¥é…ç½®**ï¼š

```bash
# /etc/nagios/conf.d/dns_checks.cfg

# å®šä¹‰DNSæœåŠ¡å™¨ä¸»æœº
define host {
    host_name           dns-server-1
    alias               ä¸»DNSæœåŠ¡å™¨
    address             192.168.1.10
    check_command       check-host-alive
    max_check_attempts  3
    check_period        24x7
    notification_period 24x7
    contacts            admin
}

# DNSæœåŠ¡è¿›ç¨‹æ£€æŸ¥
define service {
    host_name           dns-server-1
    service_description DNSè¿›ç¨‹çŠ¶æ€
    check_command       check_nrpe!check_procs_named
    max_check_attempts  3
    check_interval      5
    retry_interval      1
    notification_period 24x7
    contacts            admin
}

# DNSè§£æåŠŸèƒ½æ£€æŸ¥
define service {
    host_name           dns-server-1  
    service_description DNSè§£ææµ‹è¯•
    check_command       check_dns!example.com!192.168.1.10
    max_check_attempts  3
    check_interval      2
    retry_interval      1
    notification_period 24x7
    contacts            admin
}
```

**è‡ªå®šä¹‰DNSæ£€æŸ¥è„šæœ¬**ï¼š

```bash
#!/bin/bash
# check_dns_comprehensive.sh
# ç»¼åˆDNSå¥åº·æ£€æŸ¥è„šæœ¬

# é…ç½®å‚æ•°
DNS_SERVER="192.168.1.10"
TEST_DOMAINS=("example.com" "internal.local")
TIMEOUT=5

# æ£€æŸ¥å‡½æ•°
check_dns_port() {
    if timeout $TIMEOUT nc -u -z $DNS_SERVER 53; then
        echo "OK: DNSç«¯å£53å¯è¾¾"
        return 0
    else
        echo "CRITICAL: DNSç«¯å£53ä¸å¯è¾¾"
        return 2
    fi
}

check_dns_resolution() {
    local domain=$1
    local expected_ip=$2
    
    result=$(dig +short +time=$TIMEOUT @$DNS_SERVER $domain)
    
    if [ -z "$result" ]; then
        echo "CRITICAL: åŸŸå $domain è§£æå¤±è´¥"
        return 2
    elif [ -n "$expected_ip" ] && [ "$result" != "$expected_ip" ]; then
        echo "WARNING: åŸŸå $domain è§£æç»“æœå¼‚å¸¸ï¼ŒæœŸæœ›:$expected_ipï¼Œå®é™…:$result"
        return 1
    else
        echo "OK: åŸŸå $domain è§£ææ­£å¸¸ -> $result"
        return 0
    fi
}

# ä¸»æ£€æŸ¥é€»è¾‘
main() {
    local exit_code=0
    
    # æ£€æŸ¥ç«¯å£
    check_dns_port
    [ $? -gt $exit_code ] && exit_code=$?
    
    # æ£€æŸ¥è§£æ
    for domain in "${TEST_DOMAINS[@]}"; do
        check_dns_resolution "$domain"
        [ $? -gt $exit_code ] && exit_code=$?
    done
    
    exit $exit_code
}

main
```

### 5.3 åŸºäºè„šæœ¬çš„æŒç»­ç›‘æ§


**å®šæ—¶ç›‘æ§è„šæœ¬**ï¼š

```bash
#!/bin/bash
# dns_continuous_monitor.sh
# DNSæœåŠ¡æŒç»­å¯ç”¨æ€§ç›‘æ§

LOGFILE="/var/log/dns_monitor.log"
ALERT_EMAIL="admin@example.com"
CHECK_INTERVAL=60  # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰

log_message() {
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] $1" >> $LOGFILE
}

send_alert() {
    local message=$1
    echo "$message" | mail -s "DNSæœåŠ¡å‘Šè­¦" $ALERT_EMAIL
    log_message "ALERT: $message"
}

check_dns_service() {
    # æ£€æŸ¥namedè¿›ç¨‹
    if ! pgrep named > /dev/null; then
        send_alert "DNSæœåŠ¡è¿›ç¨‹æœªè¿è¡Œï¼Œæ­£åœ¨å°è¯•é‡å¯"
        systemctl restart named
        sleep 10
        
        if pgrep named > /dev/null; then
            log_message "INFO: DNSæœåŠ¡é‡å¯æˆåŠŸ"
        else
            send_alert "CRITICAL: DNSæœåŠ¡é‡å¯å¤±è´¥"
        fi
    fi
    
    # æ£€æŸ¥è§£æåŠŸèƒ½
    if ! dig +short @localhost example.com > /dev/null 2>&1; then
        send_alert "DNSè§£æåŠŸèƒ½å¼‚å¸¸"
    else
        log_message "INFO: DNSè§£æåŠŸèƒ½æ­£å¸¸"
    fi
}

# æŒç»­ç›‘æ§å¾ªç¯
while true; do
    check_dns_service
    sleep $CHECK_INTERVAL
done
```

---

## 6. ğŸ“ DNSé…ç½®å˜æ›´ç®¡ç†


### 6.1 å˜æ›´ç®¡ç†çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦DNSé…ç½®å˜æ›´ç®¡ç†ï¼Ÿ**

DNSé…ç½®å˜æ›´å°±åƒä¿®æ”¹åŸå¸‚çš„è·¯ç‰ŒæŒ‡ç¤ºï¼Œä¸€ä¸ªå°é”™è¯¯å¯èƒ½å¯¼è‡´æ‰€æœ‰äººéƒ½æ‰¾ä¸åˆ°ç›®çš„åœ°ã€‚å› æ­¤éœ€è¦ä¸€å¥—ä¸¥æ ¼çš„å˜æ›´ç®¡ç†æµç¨‹ï¼Œç¡®ä¿æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯å®‰å…¨ã€å¯æ§ã€å¯è¿½æº¯çš„ã€‚

**å˜æ›´ç®¡ç†çš„æ ¸å¿ƒåŸåˆ™**ï¼š

> âš ï¸ **å˜æ›´ç®¡ç†é»„é‡‘æ³•åˆ™**  
> 1. **è®°å½•åœ¨æ¡ˆ**ï¼šæ‰€æœ‰å˜æ›´éƒ½è¦æœ‰æ–‡æ¡£è®°å½•
> 2. **æµ‹è¯•å…ˆè¡Œ**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åå†ä¸Šç”Ÿäº§
> 3. **é€æ­¥æ¨è¿›**ï¼šåˆ†é˜¶æ®µå®æ–½ï¼Œä¾¿äºé—®é¢˜å®šä½
> 4. **å¿«é€Ÿå›æ»š**ï¼šå‡ºç°é—®é¢˜è¦èƒ½å¿«é€Ÿæ¢å¤åŸçŠ¶

### 6.2 Gitç‰ˆæœ¬æ§åˆ¶é›†æˆ


**DNSé…ç½®ä»“åº“ç»“æ„**ï¼š

```
dns-configs/
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ development/
â”‚   â”‚   â”œâ”€â”€ zones/
â”‚   â”‚   â””â”€â”€ group_vars/
â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â”œâ”€â”€ zones/
â”‚   â”‚   â””â”€â”€ group_vars/
â”‚   â””â”€â”€ production/
â”‚       â”œâ”€â”€ zones/
â”‚       â””â”€â”€ group_vars/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ named.conf.j2
â”‚   â””â”€â”€ zone.j2
â”œâ”€â”€ playbooks/
â”‚   â”œâ”€â”€ deploy-dns.yml
â”‚   â””â”€â”€ rollback-dns.yml
â””â”€â”€ scripts/
    â”œâ”€â”€ validate-config.sh
    â””â”€â”€ backup-config.sh
```

**å˜æ›´æµç¨‹è‡ªåŠ¨åŒ–è„šæœ¬**ï¼š

```bash
#!/bin/bash
# dns_change_workflow.sh
# DNSé…ç½®å˜æ›´å·¥ä½œæµè„šæœ¬

REPO_DIR="/opt/dns-configs"
BACKUP_DIR="/opt/dns-backups"
ENVIRONMENT=$1
CHANGE_ID=$2

if [ -z "$ENVIRONMENT" ] || [ -z "$CHANGE_ID" ]; then
    echo "ç”¨æ³•: $0 <environment> <change_id>"
    echo "ç¤ºä¾‹: $0 production CHG-2024-001"
    exit 1
fi

log_action() {
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] [$CHANGE_ID] $1"
}

# 1. åˆ›å»ºé…ç½®å¤‡ä»½
create_backup() {
    log_action "å¼€å§‹åˆ›å»ºé…ç½®å¤‡ä»½"
    
    backup_file="$BACKUP_DIR/dns-backup-$ENVIRONMENT-$(date +%Y%m%d-%H%M%S).tar.gz"
    tar -czf "$backup_file" /etc/bind/
    
    if [ $? -eq 0 ]; then
        log_action "é…ç½®å¤‡ä»½åˆ›å»ºæˆåŠŸ: $backup_file"
        echo "$backup_file" > /tmp/dns_backup_path_$CHANGE_ID
    else
        log_action "ERROR: é…ç½®å¤‡ä»½åˆ›å»ºå¤±è´¥"
        exit 1
    fi
}

# 2. é…ç½®è¯­æ³•éªŒè¯
validate_config() {
    log_action "å¼€å§‹é…ç½®è¯­æ³•éªŒè¯"
    
    # ä½¿ç”¨named-checkconféªŒè¯ä¸»é…ç½®
    if named-checkconf /etc/bind/named.conf; then
        log_action "ä¸»é…ç½®æ–‡ä»¶è¯­æ³•éªŒè¯é€šè¿‡"
    else
        log_action "ERROR: ä¸»é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯"
        return 1
    fi
    
    # éªŒè¯åŒºåŸŸæ–‡ä»¶
    for zone_file in /etc/bind/db.*; do
        if [ -f "$zone_file" ]; then
            zone_name=$(basename "$zone_file" | sed 's/^db\.//')
            if named-checkzone "$zone_name" "$zone_file"; then
                log_action "åŒºåŸŸæ–‡ä»¶ $zone_file éªŒè¯é€šè¿‡"
            else
                log_action "ERROR: åŒºåŸŸæ–‡ä»¶ $zone_file éªŒè¯å¤±è´¥"
                return 1
            fi
        fi
    done
    
    return 0
}

# 3. éƒ¨ç½²é…ç½®
deploy_config() {
    log_action "å¼€å§‹éƒ¨ç½²DNSé…ç½®"
    
    cd $REPO_DIR
    ansible-playbook -i "environments/$ENVIRONMENT/inventory" \
                     playbooks/deploy-dns.yml \
                     --extra-vars "change_id=$CHANGE_ID"
    
    if [ $? -eq 0 ]; then
        log_action "DNSé…ç½®éƒ¨ç½²æˆåŠŸ"
        return 0
    else
        log_action "ERROR: DNSé…ç½®éƒ¨ç½²å¤±è´¥"
        return 1
    fi
}

# 4. éƒ¨ç½²åéªŒè¯
post_deploy_validation() {
    log_action "å¼€å§‹éƒ¨ç½²åéªŒè¯"
    
    # ç­‰å¾…DNSæœåŠ¡é‡å¯å®Œæˆ
    sleep 10
    
    # éªŒè¯æœåŠ¡çŠ¶æ€
    if systemctl is-active --quiet named; then
        log_action "DNSæœåŠ¡è¿è¡Œæ­£å¸¸"
    else
        log_action "ERROR: DNSæœåŠ¡æœªæ­£å¸¸è¿è¡Œ"
        return 1
    fi
    
    # éªŒè¯è§£æåŠŸèƒ½
    if dig +short @localhost example.com > /dev/null 2>&1; then
        log_action "DNSè§£æåŠŸèƒ½æ­£å¸¸"
        return 0
    else
        log_action "ERROR: DNSè§£æåŠŸèƒ½å¼‚å¸¸"
        return 1
    fi
}

# 5. å›æ»šé…ç½®
rollback_config() {
    log_action "å¼€å§‹å›æ»šé…ç½®"
    
    backup_file=$(cat /tmp/dns_backup_path_$CHANGE_ID 2>/dev/null)
    if [ -n "$backup_file" ] && [ -f "$backup_file" ]; then
        tar -xzf "$backup_file" -C /
        systemctl reload named
        log_action "é…ç½®å›æ»šå®Œæˆ"
    else
        log_action "ERROR: æœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶ï¼Œæ— æ³•å›æ»š"
        exit 1
    fi
}

# ä¸»æµç¨‹
main() {
    log_action "å¼€å§‹DNSé…ç½®å˜æ›´æµç¨‹"
    
    create_backup
    
    if deploy_config; then
        if validate_config && post_deploy_validation; then
            log_action "å˜æ›´æµç¨‹å®ŒæˆæˆåŠŸ"
            # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            rm -f /tmp/dns_backup_path_$CHANGE_ID
        else
            log_action "éƒ¨ç½²åéªŒè¯å¤±è´¥ï¼Œå¼€å§‹å›æ»š"
            rollback_config
            exit 1
        fi
    else
        log_action "éƒ¨ç½²å¤±è´¥ï¼Œå¼€å§‹å›æ»š"
        rollback_config
        exit 1
    fi
}

main
```

### 6.3 é…ç½®å˜æ›´å®¡è®¡


**å˜æ›´å®¡è®¡æ—¥å¿—è®°å½•**ï¼š

```bash
#!/bin/bash
# dns_audit_logger.sh
# DNSé…ç½®å˜æ›´å®¡è®¡æ—¥å¿—

AUDIT_LOG="/var/log/dns_audit.log"

audit_log() {
    local action=$1
    local user=$2
    local details=$3
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    echo "[$timestamp] USER:$user ACTION:$action DETAILS:$details" >> $AUDIT_LOG
}

# ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ–
inotifywait -m /etc/bind/ -e modify,create,delete --format '%w%f %e' |
while read file event; do
    audit_log "FILE_CHANGE" "$USER" "File:$file Event:$event"
done &

# Gité›†æˆå®¡è®¡
git_audit_hook() {
    # åœ¨Git post-receiveé’©å­ä¸­è°ƒç”¨
    local commit_hash=$1
    local author=$(git log -1 --format='%an <%ae>' $commit_hash)
    local message=$(git log -1 --format='%s' $commit_hash)
    
    audit_log "GIT_COMMIT" "$author" "Commit:$commit_hash Message:$message"
}
```

---

## 7. ğŸš€ æ‰¹é‡DNSé…ç½®éƒ¨ç½²


### 7.1 æ‰¹é‡éƒ¨ç½²ç­–ç•¥


**ä»€ä¹ˆæ˜¯æ‰¹é‡DNSé…ç½®éƒ¨ç½²ï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹ä½ æ˜¯è¿é”åº—çš„æ€»ç»ç†ï¼Œéœ€è¦ç»™å…¨å›½100å®¶åˆ†åº—åŒæ—¶æ›´æ–°ä»·æ ¼æ ‡ç­¾ã€‚å¦‚æœä¸€å®¶ä¸€å®¶å»æ›´æ–°ï¼Œæ•ˆç‡å¤ªä½ä¸”å®¹æ˜“å‡ºé”™ã€‚æ‰¹é‡éƒ¨ç½²å°±æ˜¯ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·ï¼ŒåŒæ—¶æ›´æ–°å¤šå°DNSæœåŠ¡å™¨çš„é…ç½®ã€‚

**æ‰¹é‡éƒ¨ç½²çš„æŒ‘æˆ˜ä¸ç­–ç•¥**ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æŒ‘æˆ˜        â”‚           è§£å†³ç­–ç•¥           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç½‘ç»œå»¶è¿Ÿå·®å¼‚     â”‚ å¹¶è¡Œæ‰§è¡Œ + è¶…æ—¶æ§åˆ¶          â”‚
â”‚ æœåŠ¡å™¨çŠ¶æ€ä¸ä¸€   â”‚ é¢„æ£€æŸ¥ + çŠ¶æ€åŒæ­¥           â”‚
â”‚ é…ç½®å†²çª        â”‚ æ¨¡æ¿åŒ–ç»Ÿä¸€ + ç¯å¢ƒéš”ç¦»        â”‚
â”‚ éƒ¨åˆ†å¤±è´¥å¤„ç†     â”‚ åˆ†ç»„éƒ¨ç½² + å¤±è´¥é‡è¯•         â”‚
â”‚ å›æ»šå¤æ‚æ€§      â”‚ åŸå­æ“ä½œ + å¿«ç…§å¤‡ä»½         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 7.2 Ansibleæ‰¹é‡éƒ¨ç½²å‰§æœ¬


**åˆ†é˜¶æ®µæ‰¹é‡éƒ¨ç½²ç­–ç•¥**ï¼š

```yaml
---
- name: DNSæœåŠ¡å™¨æ‰¹é‡é…ç½®éƒ¨ç½²
  hosts: dns_servers
  serial: "30%"  # æ¯æ¬¡å¤„ç†30%çš„æœåŠ¡å™¨ï¼Œç¡®ä¿æœåŠ¡å¯ç”¨æ€§
  become: yes
  
  vars:
    deployment_id: "{{ ansible_date_time.epoch }}"
    backup_dir: "/opt/dns-backups"
    
  pre_tasks:
    - name: åˆ›å»ºéƒ¨ç½²æ ‡è¯†
      set_fact:
        deploy_timestamp: "{{ ansible_date_time.iso8601 }}"
        deploy_id: "deploy-{{ deployment_id }}"
    
    - name: æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
      ping:
      register: connectivity_check
      failed_when: false
    
    - name: éªŒè¯DNSæœåŠ¡çŠ¶æ€
      service_facts:
      
    - name: ç¡®ä¿DNSæœåŠ¡è¿è¡Œæ­£å¸¸
      fail:
        msg: "DNSæœåŠ¡æœªè¿è¡Œï¼Œè·³è¿‡æ­¤æœåŠ¡å™¨"
      when: ansible_facts.services['named.service'].state != 'running'

  tasks:
    - name: åˆ›å»ºé…ç½®å¤‡ä»½
      shell: |
        backup_file="{{ backup_dir }}/backup-{{ inventory_hostname }}-{{ deployment_id }}.tar.gz"
        tar -czf "$backup_file" /etc/bind/
        echo "$backup_file"
      register: backup_result
      
    - name: è®°å½•å¤‡ä»½ä¿¡æ¯
      lineinfile:
        path: "/tmp/deployment-{{ deployment_id }}.log"
        line: "{{ inventory_hostname }}:{{ backup_result.stdout }}"
        create: yes
      delegate_to: localhost
      
    - name: éƒ¨ç½²æ–°çš„DNSé…ç½®
      template:
        src: "{{ item.src }}"
        dest: "{{ item.dest }}"
        backup: yes
        owner: root
        group: bind
        mode: '0644'
      loop:
        - { src: "named.conf.j2", dest: "/etc/bind/named.conf" }
        - { src: "db.example.com.j2", dest: "/etc/bind/db.example.com" }
      notify: é‡è½½DNSé…ç½®
      
    - name: éªŒè¯é…ç½®è¯­æ³•
      shell: named-checkconf /etc/bind/named.conf
      register: syntax_check
      failed_when: syntax_check.rc != 0
      
  handlers:
    - name: é‡è½½DNSé…ç½®
      service:
        name: named
        state: reloaded
      
  post_tasks:
    - name: éªŒè¯DNSæœåŠ¡çŠ¶æ€
      service_facts:
      
    - name: æµ‹è¯•DNSè§£æåŠŸèƒ½
      shell: dig +short @localhost example.com
      register: resolution_test
      failed_when: resolution_test.stdout == ""
      
    - name: è®°å½•éƒ¨ç½²æˆåŠŸ
      lineinfile:
        path: "/tmp/deployment-{{ deployment_id }}.log"
        line: "{{ inventory_hostname }}:SUCCESS:{{ ansible_date_time.iso8601 }}"
      delegate_to: localhost
```

### 7.3 æ™ºèƒ½éƒ¨ç½²æ§åˆ¶è„šæœ¬


**éƒ¨ç½²æ§åˆ¶å™¨è„šæœ¬**ï¼š

```bash
#!/bin/bash
# smart_dns_deploy.sh
# æ™ºèƒ½DNSæ‰¹é‡éƒ¨ç½²æ§åˆ¶å™¨

INVENTORY_FILE="inventory.yml"
PLAYBOOK="deploy-dns.yml"
LOG_DIR="/var/log/dns-deployment"
MAX_PARALLEL=5
RETRY_COUNT=3

# ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨
mkdir -p $LOG_DIR

log_message() {
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_DIR/deployment.log"
}

# é¢„æ£€æŸ¥å‡½æ•°
pre_deployment_check() {
    log_message "å¼€å§‹é¢„éƒ¨ç½²æ£€æŸ¥"
    
    # æ£€æŸ¥Ansibleè¿é€šæ€§
    if ansible all -i $INVENTORY_FILE -m ping --one-line > "$LOG_DIR/connectivity_check.log" 2>&1; then
        log_message "æ‰€æœ‰ç›®æ ‡æœåŠ¡å™¨è¿é€šæ€§æ­£å¸¸"
    else
        log_message "ERROR: éƒ¨åˆ†æœåŠ¡å™¨è¿é€šæ€§å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥"
        cat "$LOG_DIR/connectivity_check.log"
        return 1
    fi
    
    # æ£€æŸ¥é…ç½®æ¨¡æ¿
    for template in templates/*.j2; do
        if [ ! -f "$template" ]; then
            log_message "ERROR: ç¼ºå°‘æ¨¡æ¿æ–‡ä»¶ $template"
            return 1
        fi
    done
    
    log_message "é¢„éƒ¨ç½²æ£€æŸ¥å®Œæˆ"
    return 0
}

# åˆ†ç»„éƒ¨ç½²å‡½æ•°
deploy_by_groups() {
    local groups=("primary_dns" "secondary_dns" "cache_dns")
    
    for group in "${groups[@]}"; do
        log_message "å¼€å§‹éƒ¨ç½²DNSæœåŠ¡å™¨ç»„: $group"
        
        local attempt=1
        while [ $attempt -le $RETRY_COUNT ]; do
            log_message "ç¬¬ $attempt æ¬¡å°è¯•éƒ¨ç½²ç»„ $group"
            
            if ansible-playbook -i $INVENTORY_FILE $PLAYBOOK \
               --limit "$group" \
               --forks $MAX_PARALLEL \
               -v > "$LOG_DIR/deploy_${group}_attempt_${attempt}.log" 2>&1; then
                
                log_message "ç»„ $group éƒ¨ç½²æˆåŠŸ"
                break
            else
                log_message "ç»„ $group ç¬¬ $attempt æ¬¡éƒ¨ç½²å¤±è´¥"
                if [ $attempt -eq $RETRY_COUNT ]; then
                    log_message "ERROR: ç»„ $group éƒ¨ç½²æœ€ç»ˆå¤±è´¥"
                    return 1
                fi
                ((attempt++))
                sleep 30  # é‡è¯•å‰ç­‰å¾…
            fi
        done
        
        # ç»„é—´éƒ¨ç½²é—´éš”ï¼Œç¡®ä¿æœåŠ¡ç¨³å®š
        if [ "$group" != "${groups[-1]}" ]; then
            log_message "ç­‰å¾…æœåŠ¡ç¨³å®šï¼Œ30ç§’åéƒ¨ç½²ä¸‹ä¸€ç»„"
            sleep 30
        fi
    done
    
    return 0
}

# éƒ¨ç½²åéªŒè¯
post_deployment_validation() {
    log_message "å¼€å§‹éƒ¨ç½²åéªŒè¯"
    
    # ç”ŸæˆéªŒè¯æŠ¥å‘Š
    validation_report="$LOG_DIR/validation_report_$(date +%Y%m%d_%H%M%S).txt"
    
    {
        echo "DNSéƒ¨ç½²éªŒè¯æŠ¥å‘Š"
        echo "===================="
        echo "éªŒè¯æ—¶é—´: $(date)"
        echo ""
        
        # æ£€æŸ¥æ‰€æœ‰DNSæœåŠ¡å™¨çŠ¶æ€
        echo "æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥:"
        ansible all -i $INVENTORY_FILE -m shell \
                -a "systemctl is-active named" --one-line
        echo ""
        
        # æ£€æŸ¥DNSè§£æåŠŸèƒ½
        echo "è§£æåŠŸèƒ½æµ‹è¯•:"
        ansible all -i $INVENTORY_FILE -m shell \
                -a "dig +short @localhost example.com" --one-line
        echo ""
        
    } > "$validation_report"
    
    log_message "éªŒè¯æŠ¥å‘Šå·²ç”Ÿæˆ: $validation_report"
    
    # æ£€æŸ¥æ˜¯å¦æœ‰å¤±è´¥çš„æœåŠ¡å™¨
    if grep -q "UNREACHABLE\|FAILED" "$validation_report"; then
        log_message "WARNING: å‘ç°éƒ¨åˆ†æœåŠ¡å™¨éªŒè¯å¤±è´¥"
        return 1
    else
        log_message "æ‰€æœ‰æœåŠ¡å™¨éªŒè¯é€šè¿‡"
        return 0
    fi
}

# å›æ»šå‡½æ•°
rollback_deployment() {
    local deployment_id=$1
    log_message "å¼€å§‹å›æ»šéƒ¨ç½² $deployment_id"
    
    ansible-playbook -i $INVENTORY_FILE rollback-dns.yml \
            --extra-vars "deployment_id=$deployment_id" \
            > "$LOG_DIR/rollback_${deployment_id}.log" 2>&1
    
    if [ $? -eq 0 ]; then
        log_message "å›æ»šå®Œæˆ"
    else
        log_message "ERROR: å›æ»šå¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„"
    fi
}

# ä¸»å‡½æ•°
main() {
    local deployment_id="deploy_$(date +%Y%m%d_%H%M%S)"
    log_message "å¼€å§‹DNSæ‰¹é‡éƒ¨ç½²æµç¨‹ï¼Œéƒ¨ç½²ID: $deployment_id"
    
    # é¢„æ£€æŸ¥
    if ! pre_deployment_check; then
        log_message "é¢„æ£€æŸ¥å¤±è´¥ï¼Œç»ˆæ­¢éƒ¨ç½²"
        exit 1
    fi
    
    # æ‰§è¡Œéƒ¨ç½²
    if deploy_by_groups; then
        # éƒ¨ç½²åéªŒè¯
        if post_deployment_validation; then
            log_message "DNSæ‰¹é‡éƒ¨ç½²æµç¨‹å®ŒæˆæˆåŠŸ"
        else
            log_message "éƒ¨ç½²åéªŒè¯å¤±è´¥ï¼Œè€ƒè™‘å›æ»š"
            read -p "æ˜¯å¦æ‰§è¡Œå›æ»š? (y/N): " confirm
            if [ "$confirm" = "y" ] || [ "$confirm" = "Y" ]; then
                rollback_deployment "$deployment_id"
            fi
        fi
    else
        log_message "éƒ¨ç½²å¤±è´¥ï¼Œå¼€å§‹è‡ªåŠ¨å›æ»š"
        rollback_deployment "$deployment_id"
        exit 1
    fi
}

# è„šæœ¬å…¥å£
case "${1:-deploy}" in
    "deploy")
        main
        ;;
    "check")
        pre_deployment_check
        ;;
    "rollback")
        if [ -n "$2" ]; then
            rollback_deployment "$2"
        else
            echo "ç”¨æ³•: $0 rollback <deployment_id>"
        fi
        ;;
    *)
        echo "ç”¨æ³•: $0 {deploy|check|rollback <deployment_id>}"
        exit 1
        ;;
esac
```

---

## 8. ğŸ¥ DNSæœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬


### 8.1 å…¨é¢å¥åº·æ£€æŸ¥è®¾è®¡


**DNSå¥åº·æ£€æŸ¥çš„ç»´åº¦**

DNSæœåŠ¡å¥åº·æ£€æŸ¥å°±åƒç»™DNSæœåŠ¡å™¨åš"ä½“æ£€"ï¼Œéœ€è¦æ£€æŸ¥å¤šä¸ªæ–¹é¢ï¼š

```
DNSå¥åº·æ£€æŸ¥ä½“ç³»
â”‚
â”œâ”€â”€ åŸºç¡€æœåŠ¡æ£€æŸ¥ (åƒæ£€æŸ¥å¿ƒè·³)
â”‚   â”œâ”€â”€ è¿›ç¨‹æ˜¯å¦è¿è¡Œ
â”‚   â”œâ”€â”€ ç«¯å£æ˜¯å¦ç›‘å¬
â”‚   â””â”€â”€ æœåŠ¡æ˜¯å¦å“åº”
â”‚
â”œâ”€â”€ åŠŸèƒ½æ€§æ£€æŸ¥ (åƒæ£€æŸ¥å™¨å®˜åŠŸèƒ½)
â”‚   â”œâ”€â”€ æ­£å‘è§£ææµ‹è¯•
â”‚   â”œâ”€â”€ åå‘è§£ææµ‹è¯•  
â”‚   â”œâ”€â”€ é€’å½’æŸ¥è¯¢æµ‹è¯•
â”‚   â””â”€â”€ åŒºåŸŸä¼ è¾“æµ‹è¯•
â”‚
â”œâ”€â”€ æ€§èƒ½æ£€æŸ¥ (åƒæ£€æŸ¥ä½“èƒ½)
â”‚   â”œâ”€â”€ å“åº”æ—¶é—´æµ‹è¯•
â”‚   â”œâ”€â”€ å¹¶å‘å¤„ç†èƒ½åŠ›
â”‚   â””â”€â”€ èµ„æºä½¿ç”¨æƒ…å†µ
â”‚
â””â”€â”€ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ (åƒæ£€æŸ¥æ•°æ®å‡†ç¡®æ€§)
    â”œâ”€â”€ ä¸»ä»åŒæ­¥çŠ¶æ€
    â”œâ”€â”€ é…ç½®æ–‡ä»¶å®Œæ•´æ€§
    â””â”€â”€ åŒºåŸŸæ•°æ®ä¸€è‡´æ€§
```

### 8.2 ç»¼åˆå¥åº·æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# dns_health_checker.sh
# DNSæœåŠ¡ç»¼åˆå¥åº·æ£€æŸ¥è„šæœ¬

# ============================================================================
# é…ç½®åŒºåŸŸ
# ============================================================================

# åŸºæœ¬é…ç½®
DNS_SERVER="localhost"
DNS_PORT=53
TIMEOUT=5
LOG_FILE="/var/log/dns_health_check.log"
REPORT_FILE="/tmp/dns_health_report_$(date +%Y%m%d_%H%M%S).txt"

# æµ‹è¯•åŸŸåé…ç½®
declare -A TEST_DOMAINS=(
    ["example.com"]="93.184.216.34"
    ["google.com"]=""
    ["internal.local"]="192.168.1.100"
)

# å¥åº·é˜ˆå€¼é…ç½®
MAX_RESPONSE_TIME=1000  # æ¯«ç§’
MAX_CPU_USAGE=80        # ç™¾åˆ†æ¯”
MAX_MEMORY_USAGE=80     # ç™¾åˆ†æ¯”

# é¢œè‰²é…ç½®ï¼ˆç”¨äºç»ˆç«¯è¾“å‡ºï¼‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# ============================================================================
# å·¥å…·å‡½æ•°
# ============================================================================

log_message() {
    local level=$1
    local message=$2
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$timestamp] [$level] $message" >> $LOG_FILE
}

print_status() {
    local status=$1
    local message=$2
    case $status in
        "OK")
            echo -e "${GREEN}âœ“${NC} $message"
            ;;
        "WARNING")
            echo -e "${YELLOW}âš ${NC} $message"
            ;;
        "ERROR")
            echo -e "${RED}âœ—${NC} $message"
            ;;
        "INFO")
            echo -e "${BLUE}â„¹${NC} $message"
            ;;
    esac
}

# ============================================================================
# æ£€æŸ¥å‡½æ•°
# ============================================================================

# 1. åŸºç¡€æœåŠ¡æ£€æŸ¥
check_dns_process() {
    print_status "INFO" "æ£€æŸ¥DNSè¿›ç¨‹çŠ¶æ€..."
    
    if pgrep -f named > /dev/null; then
        local pid=$(pgrep -f named)
        local start_time=$(ps -o lstart= -p $pid)
        print_status "OK" "DNSè¿›ç¨‹è¿è¡Œæ­£å¸¸ (PID: $pid, å¯åŠ¨æ—¶é—´: $start_time)"
        log_message "INFO" "DNSè¿›ç¨‹æ£€æŸ¥é€šè¿‡"
        return 0
    else
        print_status "ERROR" "DNSè¿›ç¨‹æœªè¿è¡Œ"
        log_message "ERROR" "DNSè¿›ç¨‹æ£€æŸ¥å¤±è´¥"
        return 1
    fi
}

check_dns_port() {
    print_status "INFO" "æ£€æŸ¥DNSç«¯å£ç›‘å¬çŠ¶æ€..."
    
    # æ£€æŸ¥UDP 53ç«¯å£
    if netstat -ulnp | grep -q ":53 "; then
        print_status "OK" "DNS UDPç«¯å£53ç›‘å¬æ­£å¸¸"
    else
        print_status "ERROR" "DNS UDPç«¯å£53æœªç›‘å¬"
        return 1
    fi
    
    # æ£€æŸ¥TCP 53ç«¯å£  
    if netstat -tlnp | grep -q ":53 "; then
        print_status "OK" "DNS TCPç«¯å£53ç›‘å¬æ­£å¸¸"
    else
        print_status "WARNING" "DNS TCPç«¯å£53æœªç›‘å¬"
    fi
    
    log_message "INFO" "DNSç«¯å£æ£€æŸ¥å®Œæˆ"
    return 0
}

check_dns_connectivity() {
    print_status "INFO" "æ£€æŸ¥DNSæœåŠ¡è¿é€šæ€§..."
    
    if timeout $TIMEOUT nc -u -z $DNS_SERVER $DNS_PORT 2>/dev/null; then
        print_status "OK" "DNSæœåŠ¡è¿é€šæ€§æ­£å¸¸"
        log_message "INFO" "DNSè¿é€šæ€§æ£€æŸ¥é€šè¿‡"
        return 0
    else
        print_status "ERROR" "DNSæœåŠ¡è¿é€šæ€§å¼‚å¸¸"
        log_message "ERROR" "DNSè¿é€šæ€§æ£€æŸ¥å¤±è´¥"
        return 1
    fi
}

# 2. åŠŸèƒ½æ€§æ£€æŸ¥
check_dns_resolution() {
    print_status "INFO" "æ£€æŸ¥DNSè§£æåŠŸèƒ½..."
    local failed_count=0
    
    for domain in "${!TEST_DOMAINS[@]}"; do
        local expected_ip="${TEST_DOMAINS[$domain]}"
        
        # æµ‹è¯•æ­£å‘è§£æ
        local start_time=$(date +%s%N)
        local result=$(dig +short +time=$TIMEOUT @$DNS_SERVER $domain 2>/dev/null)
        local end_time=$(date +%s%N)
        local response_time=$(( (end_time - start_time) / 1000000 ))  # è½¬æ¢ä¸ºæ¯«ç§’
        
        if [ -z "$result" ]; then
            print_status "ERROR" "åŸŸå $domain è§£æå¤±è´¥"
            log_message "ERROR" "åŸŸåè§£æå¤±è´¥: $domain"
            ((failed_count++))
        elif [ -n "$expected_ip" ] && [ "$result" != "$expected_ip" ]; then
            print_status "WARNING" "åŸŸå $domain è§£æç»“æœå¼‚å¸¸ (æœŸæœ›: $expected_ip, å®é™…: $result)"
            log_message "WARNING" "åŸŸåè§£æç»“æœå¼‚å¸¸: $domain"
        else
            if [ $response_time -gt $MAX_RESPONSE_TIME ]; then
                print_status "WARNING" "åŸŸå $domain è§£ææ­£å¸¸ä½†å“åº”æ…¢ (${response_time}ms > ${MAX_RESPONSE_TIME}ms)"
            else
                print_status "OK" "åŸŸå $domain è§£ææ­£å¸¸ -> $result (${response_time}ms)"
            fi
            log_message "INFO" "åŸŸåè§£ææˆåŠŸ: $domain -> $result (${response_time}ms)"
        fi
    done
    
    if [ $failed_count -eq 0 ]; then
        return 0
    else
        return 1
    fi
}

check_recursive_query() {
    print_status "INFO" "æ£€æŸ¥é€’å½’æŸ¥è¯¢åŠŸèƒ½..."
    
    # æµ‹è¯•é€’å½’æŸ¥è¯¢ä¸€ä¸ªå¤–éƒ¨åŸŸå
    if dig +short +time=$TIMEOUT @$DNS_SERVER www.google.com > /dev/null 2>&1; then
        print_status "OK" "é€’å½’æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸"
        log_message "INFO" "é€’å½’æŸ¥è¯¢æ£€æŸ¥é€šè¿‡"
        return 0
    else
        print_status "WARNING" "é€’å½’æŸ¥è¯¢åŠŸèƒ½å¼‚å¸¸æˆ–å·²ç¦ç”¨"
        log_message "WARNING" "é€’å½’æŸ¥è¯¢æ£€æŸ¥å¤±è´¥"
        return 1
    fi
}

# 3. æ€§èƒ½æ£€æŸ¥
check_dns_performance() {
    print_status "INFO" "æ£€æŸ¥DNSæœåŠ¡æ€§èƒ½..."
    
    # CPUä½¿ç”¨ç‡æ£€æŸ¥
    local cpu_usage=$(top -bn1 | grep "named" | awk '{print $9}' | head -1)
    if [ -n "$cpu_usage" ]; then
        cpu_usage=${cpu_usage%.*}  # å»æ‰å°æ•°éƒ¨åˆ†
        if [ "$cpu_usage" -gt $MAX_CPU_USAGE ]; then
            print_status "WARNING" "DNSè¿›ç¨‹CPUä½¿ç”¨ç‡è¿‡é«˜: ${cpu_usage}%"
        else
            print_status "OK" "DNSè¿›ç¨‹CPUä½¿ç”¨ç‡æ­£å¸¸: ${cpu_usage}%"
        fi
    fi
    
    # å†…å­˜ä½¿ç”¨æ£€æŸ¥
    local memory_usage=$(ps -o %mem= -C named | awk '{sum+=$1} END {print int(sum)}')
    if [ -n "$memory_usage" ] && [ "$memory_usage" -gt $MAX_MEMORY_USAGE ]; then
        print_status "WARNING" "DNSè¿›ç¨‹å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${memory_usage}%"
    else
        print_status "OK" "DNSè¿›ç¨‹å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸: ${memory_usage}%"
    fi
    
    # å¹¶å‘è¿æ¥æ•°æ£€æŸ¥
    local connections=$(netstat -an | grep ":53 " | wc -l)
    print_status "INFO" "å½“å‰DNSè¿æ¥æ•°: $connections"
    
    log_message "INFO" "DNSæ€§èƒ½æ£€æŸ¥å®Œæˆ"
}

# 4. é…ç½®æ–‡ä»¶æ£€æŸ¥
check_dns_config() {
    print_status "INFO" "æ£€æŸ¥DNSé…ç½®æ–‡ä»¶..."
    
    # ä¸»é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥
    if named-checkconf /etc/bind/named.conf 2>/dev/null; then
        print_status "OK" "ä¸»é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®"
    else
        print_status "ERROR" "ä¸»é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯"
        log_message "ERROR" "ä¸»é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥å¤±è´¥"
        return 1
    fi
    
    # åŒºåŸŸæ–‡ä»¶æ£€æŸ¥
    local zone_error_count=0
    for zone_file in /etc/bind/db.*; do
        if [ -f "$zone_file" ]; then
            local zone_name=$(basename "$zone_file" | sed 's/^db\.//')
            if named-checkzone "$zone_name" "$zone_file" > /dev/null 2>&1; then
                print_status "OK" "åŒºåŸŸæ–‡ä»¶ $zone_name è¯­æ³•æ­£ç¡®"
            else
                print_status "ERROR" "åŒºåŸŸæ–‡ä»¶ $zone_name è¯­æ³•é”™è¯¯"
                log_message "ERROR" "åŒºåŸŸæ–‡ä»¶è¯­æ³•é”™è¯¯: $zone_name"
                ((zone_error_count++))
            fi
        fi
    done
    
    if [ $zone_error_count -eq 0 ]; then
        log_message "INFO" "DNSé…ç½®æ–‡ä»¶æ£€æŸ¥é€šè¿‡"
        return 0
    else
        return 1
    fi
}

# 5. æ—¥å¿—æ£€æŸ¥
check_dns_logs() {
    print_status "INFO" "æ£€æŸ¥DNSæ—¥å¿—..."
    
    local log_files=("/var/log/named/named.log" "/var/log/syslog")
    local error_count=0
    
    for log_file in "${log_files[@]}"; do
        if [ -f "$log_file" ]; then
            # æ£€æŸ¥æœ€è¿‘1å°æ—¶çš„é”™è¯¯æ—¥å¿—
            local recent_errors=$(grep -i error "$log_file" | grep "$(date '+%Y-%m-%d %H')" | wc -l)
            
            if [ $recent_errors -gt 10 ]; then
                print_status "WARNING" "æ—¥å¿—æ–‡ä»¶ $log_file ä¸­å‘ç°è¾ƒå¤šé”™è¯¯ ($recent_errors æ¡)"
                ((error_count++))
            else
                print_status "OK" "æ—¥å¿—æ–‡ä»¶ $log_file é”™è¯¯æ•°é‡æ­£å¸¸ ($recent_errors æ¡)"
            fi
        fi
    done
    
    log_message "INFO" "DNSæ—¥å¿—æ£€æŸ¥å®Œæˆ"
    return $error_count
}

# ============================================================================
# æŠ¥å‘Šç”Ÿæˆ
# ============================================================================

generate_health_report() {
    local overall_status=$1
    
    {
        echo "DNSæœåŠ¡å¥åº·æ£€æŸ¥æŠ¥å‘Š"
        echo "===================="
        echo "æ£€æŸ¥æ—¶é—´: $(date)"
        echo "DNSæœåŠ¡å™¨: $DNS_SERVER"
        echo "æ•´ä½“çŠ¶æ€: $overall_status"
        echo ""
        
        echo "æ£€æŸ¥é¡¹ç›®æ‘˜è¦:"
        echo "------------"
        echo "âœ“ åŸºç¡€æœåŠ¡æ£€æŸ¥"
        echo "âœ“ åŠŸèƒ½æ€§æ£€æŸ¥"  
        echo "âœ“ æ€§èƒ½æ£€æŸ¥"
        echo "âœ“ é…ç½®æ–‡ä»¶æ£€æŸ¥"
        echo "âœ“ æ—¥å¿—æ£€æŸ¥"
        echo ""
        
        echo "è¯¦ç»†æ—¥å¿—:"
        echo "--------"
        tail -50 "$LOG_FILE"
        
    } > "$REPORT_FILE"
    
    print_status "INFO" "å¥åº·æ£€æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE"
}

# ============================================================================
# ä¸»å‡½æ•°
# ============================================================================

main() {
    local overall_status="HEALTHY"
    local check_count=0
    local failed_count=0
    
    echo ""
    print_status "INFO" "å¼€å§‹DNSæœåŠ¡å¥åº·æ£€æŸ¥..."
    echo ""
    
    # æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥é¡¹ç›®
    declare -a checks=(
        "check_dns_process"
        "check_dns_port" 
        "check_dns_connectivity"
        "check_dns_resolution"
        "check_recursive_query"
        "check_dns_performance"
        "check_dns_config"
        "check_dns_logs"
    )
    
    for check_func in "${checks[@]}"; do
        echo ""
        ((check_count++))
        
        if ! $check_func; then
            ((failed_count++))
            overall_status="UNHEALTHY"
        fi
    done
    
    echo ""
    echo "===================="
    
    if [ $failed_count -eq 0 ]; then
        print_status "OK" "æ‰€æœ‰æ£€æŸ¥é¡¹ç›®é€šè¿‡ ($check_count/$check_count)"
        overall_status="HEALTHY"
    elif [ $failed_count -lt $((check_count / 2)) ]; then
        print_status "WARNING" "éƒ¨åˆ†æ£€æŸ¥é¡¹ç›®å¤±è´¥ ($((check_count - failed_count))/$check_count)"
        overall_status="DEGRADED"
    else
        print_status "ERROR" "å¤šæ•°æ£€æŸ¥é¡¹ç›®å¤±è´¥ ($((check_count - failed_count))/$check_count)"
        overall_status="CRITICAL"
    fi
    
    generate_health_report "$overall_status"
    
    # æ ¹æ®çŠ¶æ€è¿”å›ç›¸åº”çš„é€€å‡ºç 
    case $overall_status in
        "HEALTHY") exit 0 ;;
        "DEGRADED") exit 1 ;;
        "CRITICAL") exit 2 ;;
        *) exit 3 ;;
    esac
}

# ============================================================================
# è„šæœ¬å…¥å£
# ============================================================================

# ç¡®ä¿ä»¥rootæƒé™è¿è¡Œï¼ˆæŸäº›æ£€æŸ¥éœ€è¦ç‰¹æƒï¼‰
if [ $EUID -ne 0 ]; then
    print_status "WARNING" "å»ºè®®ä»¥rootæƒé™è¿è¡Œä»¥è·å¾—å®Œæ•´çš„æ£€æŸ¥ç»“æœ"
fi

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p "$(dirname "$LOG_FILE")"

# å¤„ç†å‘½ä»¤è¡Œå‚æ•°
case "${1:-full}" in
    "full")
        main
        ;;
    "basic")
        check_dns_process && check_dns_port && check_dns_connectivity
        ;;
    "function")
        check_dns_resolution && check_recursive_query
        ;;
    "performance")
        check_dns_performance
        ;;
    "config")
        check_dns_config
        ;;
    *)
        echo "ç”¨æ³•: $0 {full|basic|function|performance|config}"
        echo "  full        - æ‰§è¡Œå®Œæ•´çš„å¥åº·æ£€æŸ¥ï¼ˆé»˜è®¤ï¼‰"
        echo "  basic       - åªæ£€æŸ¥åŸºç¡€æœåŠ¡çŠ¶æ€"
        echo "  function    - åªæ£€æŸ¥DNSåŠŸèƒ½"
        echo "  performance - åªæ£€æŸ¥æ€§èƒ½æŒ‡æ ‡"
        echo "  config      - åªæ£€æŸ¥é…ç½®æ–‡ä»¶"
        exit 1
        ;;
esac
```

### 8.3 å®šæ—¶å¥åº·æ£€æŸ¥ä¸å‘Šè­¦


**Crontabé…ç½®ç¤ºä¾‹**ï¼š

```bash
# DNSå¥åº·æ£€æŸ¥å®šæ—¶ä»»åŠ¡
# æ¯5åˆ†é’Ÿæ‰§è¡ŒåŸºç¡€æ£€æŸ¥
*/5 * * * * /opt/scripts/dns_health_checker.sh basic >> /var/log/dns_cron.log 2>&1

# æ¯å°æ—¶æ‰§è¡Œå®Œæ•´æ£€æŸ¥
0 * * * * /opt/scripts/dns_health_checker.sh full >> /var/log/dns_cron.log 2>&1

# æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œæ·±åº¦æ£€æŸ¥å¹¶å‘é€æŠ¥å‘Š
0 3 * * * /opt/scripts/dns_health_checker.sh full && mail -s "DNSå¥åº·æ£€æŸ¥æ—¥æŠ¥" admin@example.com < /tmp/dns_health_report_*.txt
```

**å‘Šè­¦é›†æˆè„šæœ¬**ï¼š

```bash
#!/bin/bash
# dns_alert_handler.sh
# DNSå¥åº·æ£€æŸ¥å‘Šè­¦å¤„ç†å™¨

HEALTH_CHECK_SCRIPT="/opt/scripts/dns_health_checker.sh"
ALERT_EMAIL="admin@example.com"
SLACK_WEBHOOK="https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
ALERT_THRESHOLD=2  # è¿ç»­å¤±è´¥æ¬¡æ•°é˜ˆå€¼

# çŠ¶æ€æ–‡ä»¶
STATE_FILE="/tmp/dns_health_state"
LAST_ALERT_FILE="/tmp/dns_last_alert"

send_email_alert() {
    local status=$1
    local message=$2
    
    {
        echo "DNSæœåŠ¡çŠ¶æ€å˜æ›´é€šçŸ¥"
        echo "==================="
        echo "æ—¶é—´: $(date)"
        echo "çŠ¶æ€: $status"
        echo "è¯¦æƒ…: $message"
        echo ""
        echo "è¯·åŠæ—¶æ£€æŸ¥DNSæœåŠ¡çŠ¶æ€å¹¶é‡‡å–å¿…è¦æªæ–½ã€‚"
    } | mail -s "[DNSå‘Šè­¦] DNSæœåŠ¡çŠ¶æ€: $status" $ALERT_EMAIL
}

send_slack_alert() {
    local status=$1
    local message=$2
    local color
    
    case $status in
        "CRITICAL") color="danger" ;;
        "WARNING") color="warning" ;;
        "RECOVERED") color="good" ;;
        *) color="#439FE0" ;;
    esac
    
    curl -X POST -H 'Content-type: application/json' \
         --data "{
             \"attachments\": [{
                 \"color\": \"$color\",
                 \"title\": \"DNSæœåŠ¡çŠ¶æ€: $status\",
                 \"text\": \"$message\",
                 \"footer\": \"DNSç›‘æ§ç³»ç»Ÿ\",
                 \"ts\": $(date +%s)
             }]
         }" \
         $SLACK_WEBHOOK > /dev/null 2>&1
}

check_and_alert() {
    # æ‰§è¡Œå¥åº·æ£€æŸ¥
    $HEALTH_CHECK_SCRIPT full > /tmp/dns_check_output 2>&1
    local check_result=$?
    
    # è¯»å–ä¸Šæ¬¡çŠ¶æ€
    local last_status="UNKNOWN"
    if [ -f "$STATE_FILE" ]; then
        last_status=$(cat "$STATE_FILE")
    fi
    
    # ç¡®å®šå½“å‰çŠ¶æ€
    local current_status
    case $check_result in
        0) current_status="HEALTHY" ;;
        1) current_status="DEGRADED" ;;
        2) current_status="CRITICAL" ;;
        *) current_status="UNKNOWN" ;;
    esac
    
    # ä¿å­˜å½“å‰çŠ¶æ€
    echo "$current_status" > "$STATE_FILE"
    
    # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘é€å‘Šè­¦
    if [ "$current_status" != "$last_status" ]; then
        case "$current_status" in
            "CRITICAL"|"DEGRADED")
                send_email_alert "$current_status" "DNSæœåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹é™„ä»¶æŠ¥å‘Š"
                send_slack_alert "$current_status" "DNSæœåŠ¡æ£€æŸ¥å‘ç°é—®é¢˜ï¼Œéœ€è¦å…³æ³¨"
                echo "$(date)" > "$LAST_ALERT_FILE"
                ;;
            "HEALTHY")
                if [ "$last_status" != "UNKNOWN" ]; then
                    send_email_alert "RECOVERED" "DNSæœåŠ¡å·²æ¢å¤æ­£å¸¸"
                    send_slack_alert "RECOVERED" "DNSæœåŠ¡çŠ¶æ€å·²æ¢å¤æ­£å¸¸"
                fi
                ;;
        esac
    fi
}

# ä¸»é€»è¾‘
check_and_alert
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> ğŸ¯ **DNSè‡ªåŠ¨åŒ–é…ç½®æ ¸å¿ƒç†å¿µ**  
> DNSè‡ªåŠ¨åŒ–ä¸æ˜¯ç®€å•çš„è„šæœ¬æ‰§è¡Œï¼Œè€Œæ˜¯å»ºç«‹æ ‡å‡†åŒ–ã€å¯é‡å¤ã€å¯è¿½æº¯çš„DNSæœåŠ¡ç®¡ç†ä½“ç³»

**å››å¤§æ ¸å¿ƒæ”¯æŸ±**ï¼š

```
DNSè‡ªåŠ¨åŒ–ç®¡ç†ä½“ç³»
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚è‡ªåŠ¨åŒ–é…ç½®â”‚ â† Ansibleå‰§æœ¬ã€æ¨¡æ¿åŒ–ç®¡ç†
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  
    â”‚æ€§èƒ½ç›‘æ§ â”‚ â† Prometheusã€è„šæœ¬ç›‘æ§
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚å˜æ›´ç®¡ç† â”‚ â† Gitç‰ˆæœ¬æ§åˆ¶ã€å®¡è®¡æ—¥å¿—
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚å¥åº·æ£€æŸ¥ â”‚ â† å…¨é¢æ£€æŸ¥è„šæœ¬ã€å‘Šè­¦æœºåˆ¶
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ Ansibleè‡ªåŠ¨åŒ–æœ€ä½³å®è·µ**

| å®è·µåŸåˆ™ | å…·ä½“åšæ³• | é¿å…é—®é¢˜ |
|---------|---------|---------|
| **å¹‚ç­‰æ€§** | å¤šæ¬¡æ‰§è¡Œç»“æœä¸€è‡´ | é‡å¤è¿è¡Œå¯¼è‡´é…ç½®æ··ä¹± |
| **æ¨¡æ¿åŒ–** | ä½¿ç”¨Jinja2æ¨¡æ¿ | ç¡¬ç¼–ç é…ç½®éš¾ç»´æŠ¤ |
| **åˆ†å±‚ç®¡ç†** | ç¯å¢ƒã€ä¸»æœºã€ç»„å˜é‡åˆ†ç¦» | é…ç½®æ··ä¹±éš¾ç®¡ç† |
| **é”™è¯¯å¤„ç†** | failed_whenå’Œhandlers | éƒ¨åˆ†å¤±è´¥å¯¼è‡´æœåŠ¡å¼‚å¸¸ |

**ğŸ”¹ ç›‘æ§è®¾è®¡è¦ç‚¹**

```
ç›‘æ§æ•°æ®æµå‘å›¾

åŸå§‹æ•°æ®æ”¶é›† â†’ æ•°æ®å¤„ç† â†’ å­˜å‚¨ â†’ åˆ†æ â†’ å‘Šè­¦
     â†“            â†“       â†“     â†“     â†“
  digå‘½ä»¤      è„šæœ¬å¤„ç†   æ–‡ä»¶   é˜ˆå€¼  é‚®ä»¶/æ¶ˆæ¯
  systemctl    æ­£åˆ™åŒ¹é…   æ•°æ®åº“ æ¯”è¾ƒ  æ¨é€
  netstat      è®¡ç®—ç»Ÿè®¡   æ—¶åºåº“ è¶‹åŠ¿  
```

**ğŸ”¹ å˜æ›´ç®¡ç†æµç¨‹**

> âš ï¸ **å˜æ›´å®‰å…¨åŸåˆ™**  
> ä»»ä½•DNSé…ç½®å˜æ›´éƒ½åº”è¯¥éµå¾ªï¼š"æµ‹è¯•éªŒè¯ â†’ åˆ†é˜¶æ®µéƒ¨ç½² â†’ ç›‘æ§éªŒè¯ â†’ é—®é¢˜å›æ»š"çš„æµç¨‹

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š é€‚ç”¨åœºæ™¯åˆ¤æ–­**

```
DNSè‡ªåŠ¨åŒ–é€‚ç”¨æ€§è¯„ä¼°è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åœºæ™¯       â”‚ é€‚ç”¨åº¦  â”‚  å»ºè®®   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡å™¨æ•°é‡>10å°  â”‚ â˜…â˜…â˜…â˜…â˜… â”‚ å¼ºçƒˆæ¨èâ”‚
â”‚ é…ç½®å˜æ›´é¢‘ç¹     â”‚ â˜…â˜…â˜…â˜…â˜† â”‚ æ¨èä½¿ç”¨â”‚
â”‚ å¤šç¯å¢ƒéƒ¨ç½²      â”‚ â˜…â˜…â˜…â˜…â˜… â”‚ å¿…é¡»ä½¿ç”¨â”‚
â”‚ äººå‘˜æŠ€èƒ½å……è¶³     â”‚ â˜…â˜…â˜…â˜†â˜† â”‚ é€æ­¥å®æ–½â”‚
â”‚ é¢„ç®—å……è¶³        â”‚ â˜…â˜…â˜…â˜†â˜† â”‚ åˆ†é˜¶æ®µå®æ–½â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ› ï¸ å®æ–½å»ºè®®**

**ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è‡ªåŠ¨åŒ–**
- ä½¿ç”¨Ansibleå®ç°DNSè½¯ä»¶åŒ…å®‰è£…
- å»ºç«‹åŸºç¡€çš„é…ç½®æ¨¡æ¿
- å®ç°ç®€å•çš„æ‰¹é‡éƒ¨ç½²

**ç¬¬äºŒé˜¶æ®µï¼šç›‘æ§ä½“ç³»**  
- éƒ¨ç½²æ€§èƒ½ç›‘æ§å·¥å…·
- å»ºç«‹å¥åº·æ£€æŸ¥è„šæœ¬
- é…ç½®åŸºç¡€å‘Šè­¦æœºåˆ¶

**ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå–„ç®¡ç†**
- é›†æˆGitç‰ˆæœ¬æ§åˆ¶
- å»ºç«‹å˜æ›´å®¡æ‰¹æµç¨‹
- å®ç°è‡ªåŠ¨åŒ–å›æ»š

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ å¸¸è§éƒ¨ç½²é—®é¢˜**

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|------|---------|
| **Ansibleè¿æ¥å¤±è´¥** | SSHå¯†é’¥ã€ç½‘ç»œé—®é¢˜ | æ£€æŸ¥å¯†é’¥é…ç½®å’Œç½‘ç»œè¿é€šæ€§ |
| **æ¨¡æ¿æ¸²æŸ“é”™è¯¯** | å˜é‡æœªå®šä¹‰ã€è¯­æ³•é”™è¯¯ | ä½¿ç”¨ansible-playbook --checkéªŒè¯ |
| **é…ç½®è¯­æ³•é”™è¯¯** | æ¨¡æ¿é€»è¾‘é—®é¢˜ | å¢åŠ named-checkconféªŒè¯æ­¥éª¤ |
| **æœåŠ¡é‡å¯å¤±è´¥** | é…ç½®é”™è¯¯ã€æƒé™é—®é¢˜ | æ·»åŠ æœåŠ¡çŠ¶æ€æ£€æŸ¥å’Œå›æ»šæœºåˆ¶ |

**ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®**

> ğŸ’¡ **æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**  
> - ç›‘æ§é‡‡é›†é¢‘ç‡è¦é€‚ä¸­ï¼ˆä¸è¦è¿‡äºé¢‘ç¹å½±å“æ€§èƒ½ï¼‰
> - æ‰¹é‡éƒ¨ç½²è¦æ§åˆ¶å¹¶å‘æ•°é‡ï¼ˆé¿å…ç½‘ç»œæ‹¥å¡ï¼‰
> - æ—¥å¿—è®°å½•è¦æœ‰è½®è½¬æœºåˆ¶ï¼ˆé˜²æ­¢ç£ç›˜ç©ºé—´ä¸è¶³ï¼‰

### 9.5 è¿›é˜¶å­¦ä¹ è·¯å¾„


**ğŸ“ æŠ€èƒ½æå‡å»ºè®®**

1. **æ·±å…¥å­¦ä¹ Ansible**
   - æŒæ¡Ansible Galaxyè§’è‰²ä½¿ç”¨
   - å­¦ä¹ è‡ªå®šä¹‰æ¨¡å—å¼€å‘
   - ç†è§£Ansible VaultåŠ å¯†ç®¡ç†

2. **ç›‘æ§ç³»ç»Ÿé›†æˆ**
   - å­¦ä¹ Prometheusé…ç½®å’Œä½¿ç”¨
   - æŒæ¡Grafanaä»ªè¡¨æ¿è®¾è®¡
   - äº†è§£ELKæ—¥å¿—åˆ†ææ ˆ

3. **DevOpså®è·µ**
   - å­¦ä¹ CI/CDæµæ°´çº¿é›†æˆ
   - æŒæ¡å®¹å™¨åŒ–DNSéƒ¨ç½²
   - äº†è§£åŸºç¡€è®¾æ–½å³ä»£ç (IaC)

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- DNSè‡ªåŠ¨åŒ–ï¼Œæ ‡å‡†æ¨¡æ¿åŒ–
- ç›‘æ§å‘Šè­¦å…¨è¦†ç›–ï¼Œå˜æ›´ç®¡ç†è¦è§„èŒƒ  
- å¥åº·æ£€æŸ¥ä¿ç¨³å®šï¼Œæ‰¹é‡éƒ¨ç½²æ§é£é™©
- ç‰ˆæœ¬æ§åˆ¶å¯è¿½æº¯ï¼Œå›æ»šæœºåˆ¶è¦å®Œå–„