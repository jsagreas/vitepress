---
title: 8ã€DNSæ•…éšœè¯Šæ–­ä¸æ’æŸ¥å·¥å…·
---
## ğŸ“š ç›®å½•

1. [DNSæ•…éšœæ’æŸ¥æ¦‚è¿°](#1-DNSæ•…éšœæ’æŸ¥æ¦‚è¿°)
2. [nslookupåŸŸåæŸ¥è¯¢å·¥å…·](#2-nslookupåŸŸåæŸ¥è¯¢å·¥å…·)
3. [dig DNSæŸ¥è¯¢è°ƒè¯•å·¥å…·](#3-dig-DNSæŸ¥è¯¢è°ƒè¯•å·¥å…·)
4. [hostç®€å•DNSæŸ¥è¯¢å‘½ä»¤](#4-hostç®€å•DNSæŸ¥è¯¢å‘½ä»¤)
5. [resolvectl statusè§£æçŠ¶æ€æŸ¥çœ‹](#5-resolvectl-statusè§£æçŠ¶æ€æŸ¥çœ‹)
6. [åŸŸåè§£æè¶…æ—¶æ’æŸ¥](#6-åŸŸåè§£æè¶…æ—¶æ’æŸ¥)
7. [DNSæœåŠ¡å™¨å¯è¾¾æ€§æµ‹è¯•](#7-DNSæœåŠ¡å™¨å¯è¾¾æ€§æµ‹è¯•)
8. [è§£æè·¯å¾„è·Ÿè¸ªåˆ†æ](#8-è§£æè·¯å¾„è·Ÿè¸ªåˆ†æ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” DNSæ•…éšœæ’æŸ¥æ¦‚è¿°


### 1.1 DNSæ•…éšœçš„å¸¸è§è¡¨ç°


DNSï¼ˆåŸŸåç³»ç»Ÿï¼‰æ•…éšœæ˜¯ç½‘ç»œé—®é¢˜ä¸­æœ€å¸¸è§çš„ç±»å‹ä¹‹ä¸€ï¼Œå°±åƒç°å®ç”Ÿæ´»ä¸­ç”µè¯ç°¿å‡ºäº†é—®é¢˜ï¼Œä½ å°±æ— æ³•é€šè¿‡å§“åæ‰¾åˆ°å¯¹åº”çš„ç”µè¯å·ç ã€‚

```
å¸¸è§DNSæ•…éšœç°è±¡ï¼š
â€¢ ç½‘ç«™æ— æ³•è®¿é—®ï¼Œæç¤º"åŸŸåæ— æ³•è§£æ"
â€¢ åº”ç”¨ç¨‹åºè¿æ¥è¶…æ—¶
â€¢ é‚®ä»¶æœåŠ¡å¼‚å¸¸
â€¢ ç½‘ç»œæœåŠ¡å“åº”ç¼“æ…¢
```

**ğŸ¯ æ•…éšœæ’æŸ¥æ€è·¯**

DNSé—®é¢˜æ’æŸ¥éµå¾ª"ç”±å†…åˆ°å¤–ã€ç”±ç®€åˆ°ç¹"çš„åŸåˆ™ï¼š

```
æ’æŸ¥å±‚æ¬¡ï¼š
æœ¬åœ°é…ç½® â†’ æœ¬åœ°DNS â†’ ä¸Šæ¸¸DNS â†’ æƒå¨DNS
    â†“         â†“         â†“         â†“
hostsæ–‡ä»¶   æœ¬åœ°ç¼“å­˜   ISPæœåŠ¡å™¨  åŸŸåæœåŠ¡å™¨
```

### 1.2 æ•…éšœæ’æŸ¥çš„åŸºæœ¬æµç¨‹


**ğŸ“‹ æ ‡å‡†æ’æŸ¥æ­¥éª¤**

```
ç¬¬ä¸€æ­¥ï¼šç¡®è®¤ç½‘ç»œè¿é€šæ€§
ping 8.8.8.8  # æµ‹è¯•ç½‘ç»œæ˜¯å¦æ­£å¸¸

ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æœ¬åœ°DNSé…ç½®
cat /etc/resolv.conf  # æŸ¥çœ‹DNSæœåŠ¡å™¨è®¾ç½®

ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ä¸“ä¸šå·¥å…·è¯Šæ–­
nslookup/dig/host  # è¯¦ç»†åˆ†æè§£æè¿‡ç¨‹

ç¬¬å››æ­¥ï¼šè·Ÿè¸ªè§£æè·¯å¾„
è¿½è¸ªå®Œæ•´çš„åŸŸåè§£æé“¾æ¡
```

---

## 2. ğŸ”§ nslookupåŸŸåæŸ¥è¯¢å·¥å…·


### 2.1 nslookupå·¥å…·åŸºç¡€


`nslookup`æ˜¯æœ€ä¼ ç»Ÿçš„DNSæŸ¥è¯¢å·¥å…·ï¼Œå°±åƒä¸€ä¸ª"åŸŸåç¿»è¯‘å™¨"ï¼Œå¸®ä½ æŠŠåŸŸåç¿»è¯‘æˆIPåœ°å€ï¼Œæˆ–è€…åè¿‡æ¥æŠŠIPåœ°å€ç¿»è¯‘æˆåŸŸåã€‚

**ğŸ”¸ åŸºæœ¬è¯­æ³•**

```bash
# åŸºæœ¬æŸ¥è¯¢æ ¼å¼
nslookup [åŸŸå/IP] [DNSæœåŠ¡å™¨]
```

### 2.2 å¸¸ç”¨æŸ¥è¯¢æ“ä½œ


**ğŸ“ æ­£å‘è§£ææŸ¥è¯¢**

```bash
# æŸ¥è¯¢åŸŸåå¯¹åº”çš„IPåœ°å€
$ nslookup www.baidu.com
Server:    8.8.8.8
Address:   8.8.8.8#53

Non-authoritative answer:
www.baidu.com   canonical name = www.a.shifen.com.
www.a.shifen.com    canonical name = www.wshifen.com.
Name:   www.wshifen.com
Address: 103.235.46.39
```

**ğŸ”„ åå‘è§£ææŸ¥è¯¢**

```bash
# é€šè¿‡IPåœ°å€æŸ¥è¯¢å¯¹åº”çš„åŸŸå
$ nslookup 8.8.8.8
Server:    8.8.8.8
Address:   8.8.8.8#53

Non-authoritative answer:
8.8.8.8.in-addr.arpa    name = dns.google.
```

**ğŸ¯ æŒ‡å®šDNSæœåŠ¡å™¨æŸ¥è¯¢**

```bash
# ä½¿ç”¨ç‰¹å®šDNSæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢
$ nslookup www.example.com 114.114.114.114
Server:    114.114.114.114
Address:   114.114.114.114#53
```

### 2.3 äº¤äº’æ¨¡å¼ä½¿ç”¨


**ğŸ’» è¿›å…¥äº¤äº’æ¨¡å¼**

```bash
$ nslookup
> set type=A          # è®¾ç½®æŸ¥è¯¢ç±»å‹ä¸ºAè®°å½•
> www.example.com     # æŸ¥è¯¢åŸŸå
> set type=MX         # åˆ‡æ¢åˆ°é‚®ä»¶äº¤æ¢è®°å½•æŸ¥è¯¢
> example.com         # æŸ¥è¯¢é‚®ä»¶æœåŠ¡å™¨
> exit                # é€€å‡ºäº¤äº’æ¨¡å¼
```

**ğŸ“Š æŸ¥è¯¢ä¸åŒè®°å½•ç±»å‹**

| è®°å½•ç±»å‹ | **ä½œç”¨è¯´æ˜** | **æŸ¥è¯¢ç¤ºä¾‹** |
|---------|-------------|-------------|
| **A** | `åŸŸåå¯¹åº”çš„IPv4åœ°å€` | `set type=A` |
| **AAAA** | `åŸŸåå¯¹åº”çš„IPv6åœ°å€` | `set type=AAAA` |
| **MX** | `é‚®ä»¶äº¤æ¢æœåŠ¡å™¨` | `set type=MX` |
| **NS** | `åŸŸåæœåŠ¡å™¨` | `set type=NS` |
| **CNAME** | `åˆ«åè®°å½•` | `set type=CNAME` |
| **TXT** | `æ–‡æœ¬è®°å½•` | `set type=TXT` |

### 2.4 nslookupæ•…éšœè¯Šæ–­


**âš ï¸ å¸¸è§é”™è¯¯ä¿¡æ¯**

```bash
# åŸŸåä¸å­˜åœ¨
** server can't find www.nonexist.com: NXDOMAIN

# DNSæœåŠ¡å™¨æ— å“åº”
;; connection timed out; no servers could be reached

# æƒé™æ‹’ç»
** server can't find www.example.com: REFUSED
```

**ğŸ’¡ è§£è¯»æŸ¥è¯¢ç»“æœ**

```
Server: æ˜¾ç¤ºä½¿ç”¨çš„DNSæœåŠ¡å™¨
Address: DNSæœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£
Non-authoritative answer: éæƒå¨å›ç­”ï¼ˆä»ç¼“å­˜è·å–ï¼‰
canonical name: åˆ«åæŒ‡å‘çš„çœŸå®åŸŸå
```

---

## 3. ğŸ” dig DNSæŸ¥è¯¢è°ƒè¯•å·¥å…·


### 3.1 digå·¥å…·æ¦‚è¿°


`dig`ï¼ˆDomain Information Groperï¼‰æ˜¯æ¯”nslookupæ›´å¼ºå¤§çš„DNSæŸ¥è¯¢å·¥å…·ï¼Œå°±åƒä¸€ä¸ª"DNSä¾¦æ¢"ï¼Œèƒ½å¤Ÿæä¾›æ›´è¯¦ç»†ã€æ›´ä¸“ä¸šçš„DNSä¿¡æ¯ã€‚

**ğŸ¯ digçš„ä¼˜åŠ¿**

```
ç›¸æ¯”nslookupçš„ä¼˜ç‚¹ï¼š
â€¢ è¾“å‡ºæ ¼å¼æ›´æ¸…æ™°ï¼Œä¾¿äºè„šæœ¬å¤„ç†
â€¢ æä¾›æ›´è¯¦ç»†çš„æŸ¥è¯¢ä¿¡æ¯
â€¢ æ”¯æŒæ‰¹é‡æŸ¥è¯¢
â€¢ æ›´å¥½çš„è°ƒè¯•åŠŸèƒ½
```

### 3.2 åŸºæœ¬æŸ¥è¯¢æ“ä½œ


**ğŸ“ æ ‡å‡†æŸ¥è¯¢æ ¼å¼**

```bash
# åŸºæœ¬æŸ¥è¯¢è¯­æ³•
dig [@DNSæœåŠ¡å™¨] åŸŸå [æŸ¥è¯¢ç±»å‹] [æŸ¥è¯¢é€‰é¡¹]
```

**ğŸ”¸ ç®€å•æŸ¥è¯¢ç¤ºä¾‹**

```bash
# æŸ¥è¯¢Aè®°å½•ï¼ˆé»˜è®¤ï¼‰
$ dig www.baidu.com

; <<>> DiG 9.16.1 <<>> www.baidu.com
;; QUESTION SECTION:
;www.baidu.com.          IN  A

;; ANSWER SECTION:
www.baidu.com.   1200   IN  CNAME   www.a.shifen.com.
www.a.shifen.com. 300   IN  CNAME   www.wshifen.com.
www.wshifen.com.  300   IN  A       103.235.46.39

;; Query time: 23 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Mon Jan 15 10:30:00 CST 2025
;; MSG SIZE  rcvd: 90
```

### 3.3 é«˜çº§æŸ¥è¯¢åŠŸèƒ½


**ğŸ”§ æŒ‡å®šæŸ¥è¯¢ç±»å‹**

```bash
# æŸ¥è¯¢ä¸åŒç±»å‹çš„DNSè®°å½•
dig example.com MX      # é‚®ä»¶äº¤æ¢è®°å½•
dig example.com NS      # åŸŸåæœåŠ¡å™¨è®°å½•
dig example.com TXT     # æ–‡æœ¬è®°å½•
dig example.com AAAA    # IPv6åœ°å€è®°å½•
```

**ğŸ¯ æŒ‡å®šDNSæœåŠ¡å™¨**

```bash
# ä½¿ç”¨ç‰¹å®šDNSæœåŠ¡å™¨æŸ¥è¯¢
dig @8.8.8.8 www.example.com
dig @114.114.114.114 www.example.com A
```

**ğŸ“Š ç®€åŒ–è¾“å‡ºæ ¼å¼**

```bash
# åªæ˜¾ç¤ºç­”æ¡ˆéƒ¨åˆ†
$ dig +short www.baidu.com
www.a.shifen.com.
www.wshifen.com.
103.235.46.39

# åªæ˜¾ç¤ºIPåœ°å€
$ dig +short +answer www.baidu.com A
103.235.46.39
```

### 3.4 è¿½è¸ªæŸ¥è¯¢è·¯å¾„


**ğŸ” å®Œæ•´è§£æè·¯å¾„è¿½è¸ª**

```bash
# è¿½è¸ªå®Œæ•´çš„DNSè§£æè¿‡ç¨‹
$ dig +trace www.example.com

; <<>> DiG 9.16.1 <<>> +trace www.example.com
;; QUESTION SECTION:
;www.example.com.        IN  A

.                       518400  IN  NS  a.root-servers.net.
[æ˜¾ç¤ºä»æ ¹æœåŠ¡å™¨å¼€å§‹çš„å®Œæ•´è§£æè·¯å¾„]
```

**ğŸ“ˆ è§£æè¿‡ç¨‹è¯´æ˜**

```
DNSè§£æè·¯å¾„ï¼š
æœ¬åœ°DNS â†’ æ ¹æœåŠ¡å™¨(.) â†’ é¡¶çº§åŸŸæœåŠ¡å™¨(.com) â†’ æƒå¨æœåŠ¡å™¨(example.com)
```

---

## 4. ğŸ” hostç®€å•DNSæŸ¥è¯¢å‘½ä»¤


### 4.1 hostå·¥å…·ç‰¹ç‚¹


`host`å‘½ä»¤æ˜¯æœ€ç®€æ´çš„DNSæŸ¥è¯¢å·¥å…·ï¼Œå°±åƒä¸€ä¸ª"å¿«é€ŸæŸ¥å·å°"ï¼Œä¸“é—¨ç”¨äºå¿«é€Ÿè·å–åŸºæœ¬çš„DNSä¿¡æ¯ã€‚

**ğŸ’¡ hostçš„ç‰¹è‰²**

```
è®¾è®¡ç†å¿µï¼š
â€¢ è¾“å‡ºç®€æ´æ˜äº†
â€¢ æ“ä½œç®€å•å¿«é€Ÿ
â€¢ é€‚åˆè„šæœ¬ç¼–ç¨‹
â€¢ ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½
```

### 4.2 åŸºæœ¬ä½¿ç”¨æ–¹æ³•


**ğŸ“ å¸¸ç”¨æŸ¥è¯¢æ ¼å¼**

```bash
# æœ€ç®€å•çš„æŸ¥è¯¢
$ host www.baidu.com
www.baidu.com is an alias for www.a.shifen.com.
www.a.shifen.com is an alias for www.wshifen.com.
www.wshifen.com has address 103.235.46.39

# åå‘æŸ¥è¯¢
$ host 8.8.8.8
8.8.8.8.in-addr.arpa domain name pointer dns.google.
```

**ğŸ”§ æŒ‡å®šæŸ¥è¯¢ç±»å‹**

```bash
# æŸ¥è¯¢é‚®ä»¶æœåŠ¡å™¨
$ host -t MX example.com
example.com mail is handled by 10 mail.example.com.

# æŸ¥è¯¢åŸŸåæœåŠ¡å™¨
$ host -t NS example.com
example.com name server ns1.example.com.
example.com name server ns2.example.com.
```

### 4.3 å®ç”¨æŸ¥è¯¢é€‰é¡¹


**âš¡ å¿«é€Ÿæ‰¹é‡æŸ¥è¯¢**

```bash
# æŸ¥è¯¢å¤šä¸ªåŸŸåï¼ˆè„šæœ¬ä¸­å¸¸ç”¨ï¼‰
for domain in www.baidu.com www.google.com www.github.com; do
    echo "=== $domain ==="
    host $domain
done
```

**ğŸ¯ æŒ‡å®šDNSæœåŠ¡å™¨**

```bash
# ä½¿ç”¨ç‰¹å®šDNSæœåŠ¡å™¨
host www.example.com 8.8.8.8
host -t MX example.com 114.114.114.114
```

---

## 5. âš™ï¸ resolvectl statusè§£æçŠ¶æ€æŸ¥çœ‹


### 5.1 systemd-resolvedæœåŠ¡


åœ¨ç°ä»£Linuxç³»ç»Ÿä¸­ï¼Œ`systemd-resolved`ç®¡ç†DNSè§£æï¼Œ`resolvectl`æ˜¯æŸ¥çœ‹å’Œç®¡ç†DNSçŠ¶æ€çš„ä¸“é—¨å·¥å…·ï¼Œå°±åƒç³»ç»Ÿçš„"DNSå¥åº·æ£€æŸ¥å™¨"ã€‚

**ğŸ”¸ ä»€ä¹ˆæ˜¯systemd-resolved**

```
systemd-resolvedçš„ä½œç”¨ï¼š
â€¢ ç»Ÿä¸€ç®¡ç†ç³»ç»ŸDNSè§£æ
â€¢ æä¾›DNSç¼“å­˜åŠŸèƒ½
â€¢ æ”¯æŒå¤šç½‘ç»œæ¥å£çš„DNSé…ç½®
â€¢ é›†æˆDNSSECéªŒè¯
```

### 5.2 æŸ¥çœ‹è§£æçŠ¶æ€


**ğŸ“Š ç³»ç»ŸDNSçŠ¶æ€æ€»è§ˆ**

```bash
# æŸ¥çœ‹å®Œæ•´çš„DNSè§£æçŠ¶æ€
$ resolvectl status
Global
       LLMNR setting: yes
       MulticastDNS setting: no
       DNSOverTLS setting: no
       DNSSEC setting: allow-downgrade
       DNSSEC supported: yes
       Current DNS Server: 8.8.8.8
             DNS Servers: 8.8.8.8
                          8.8.4.4
          DNS Domain: ~.

Link 2 (enp0s3)
      Current Scopes: DNS
       LLMNR setting: yes
       MulticastDNS setting: no
       DNSOverTLS setting: no
       DNSSEC setting: allow-downgrade
       DNSSEC supported: yes
    Current DNS Server: 192.168.1.1
          DNS Servers: 192.168.1.1
```

**ğŸ” æŸ¥çœ‹DNSç¼“å­˜**

```bash
# æŸ¥çœ‹DNSç¼“å­˜ç»Ÿè®¡
$ resolvectl statistics
DNSSEC supported by current servers: yes

Transactions
Current Transactions: 0
  Total Transactions: 1234

Cache
  Current Cache Size: 15
          Cache Hits: 856
        Cache Misses: 378
```

### 5.3 ç®¡ç†DNSè§£æ


**ğŸ”§ åˆ·æ–°DNSç¼“å­˜**

```bash
# æ¸…ç©ºDNSç¼“å­˜
sudo resolvectl flush-caches

# éªŒè¯ç¼“å­˜å·²æ¸…ç©º
resolvectl statistics
```

**âš¡ æ‰‹åŠ¨æŸ¥è¯¢æµ‹è¯•**

```bash
# ä½¿ç”¨resolvectlè¿›è¡ŒDNSæŸ¥è¯¢
$ resolvectl query www.example.com
www.example.com: 93.184.216.34

# æŸ¥è¯¢ç‰¹å®šè®°å½•ç±»å‹
$ resolvectl query --type=MX example.com
example.com IN MX 10 mail.example.com
```

---

## 6. â° åŸŸåè§£æè¶…æ—¶æ’æŸ¥


### 6.1 è¶…æ—¶é—®é¢˜çš„å¸¸è§åŸå› 


åŸŸåè§£æè¶…æ—¶å°±åƒæ‰“ç”µè¯æ—¶ä¸€ç›´æ²¡äººæ¥å¬ï¼Œå¯èƒ½çš„åŸå› æœ‰å¾ˆå¤šç§ã€‚

**ğŸš« å¸¸è§è¶…æ—¶åŸå› **

```
ç½‘ç»œå±‚é¢ï¼š
â€¢ DNSæœåŠ¡å™¨ä¸å¯è¾¾
â€¢ ç½‘ç»œå»¶è¿Ÿè¿‡é«˜
â€¢ é˜²ç«å¢™é˜»æ­¢DNSè¯·æ±‚

é…ç½®å±‚é¢ï¼š
â€¢ DNSæœåŠ¡å™¨åœ°å€é”™è¯¯
â€¢ è¶…æ—¶æ—¶é—´è®¾ç½®è¿‡çŸ­
â€¢ ç½‘ç»œæ¥å£é…ç½®é—®é¢˜

æœåŠ¡å±‚é¢ï¼š
â€¢ DNSæœåŠ¡å™¨è¿‡è½½
â€¢ åŸŸåä¸å­˜åœ¨
â€¢ DNSè®°å½•é…ç½®é”™è¯¯
```

### 6.2 è¶…æ—¶æ’æŸ¥æ­¥éª¤


**ğŸ“‹ ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•**

```bash
# ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥DNSæœåŠ¡å™¨è¿é€šæ€§
ping 8.8.8.8
ping 114.114.114.114

# ç¬¬äºŒæ­¥ï¼šæµ‹è¯•DNSç«¯å£å¯è¾¾æ€§
telnet 8.8.8.8 53
nc -u -v 8.8.8.8 53  # UDPæ–¹å¼æµ‹è¯•

# ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ä¸åŒå·¥å…·å¯¹æ¯”æµ‹è¯•
time nslookup www.example.com
time dig www.example.com
time host www.example.com
```

**â±ï¸ è®¾ç½®è¶…æ—¶å‚æ•°**

```bash
# digè®¾ç½®è¶…æ—¶æ—¶é—´
dig +time=5 www.example.com

# ä½¿ç”¨timeoutå‘½ä»¤é™åˆ¶æ‰§è¡Œæ—¶é—´
timeout 10 nslookup www.example.com
```

### 6.3 è¶…æ—¶é—®é¢˜è§£å†³


**ğŸ”§ è°ƒæ•´DNSé…ç½®**

```bash
# ä¸´æ—¶æ›´æ”¹DNSæœåŠ¡å™¨
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf

# æ°¸ä¹…ä¿®æ”¹DNSé…ç½®ï¼ˆUbuntu/Debianï¼‰
sudo systemctl edit systemd-resolved
# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
[Service]
Environment=SYSTEMD_LOG_LEVEL=debug
```

**âš¡ ä¼˜åŒ–è§£ææ€§èƒ½**

```bash
# æ£€æŸ¥å¹¶ä¼˜åŒ–ç½‘ç»œMTU
ip link show
sudo ip link set dev eth0 mtu 1500

# ä½¿ç”¨æœ¬åœ°DNSç¼“å­˜
sudo apt install dnsmasq
sudo systemctl enable dnsmasq
```

---

## 7. ğŸŒ DNSæœåŠ¡å™¨å¯è¾¾æ€§æµ‹è¯•


### 7.1 ç½‘ç»œè¿é€šæ€§æµ‹è¯•


DNSæœåŠ¡å™¨å¯è¾¾æ€§æµ‹è¯•å°±åƒæ£€æŸ¥ç”µè¯çº¿è·¯æ˜¯å¦é€šç•…ï¼Œç¡®ä¿DNSè¯·æ±‚èƒ½å¤Ÿæ­£å¸¸åˆ°è¾¾æœåŠ¡å™¨ã€‚

**ğŸ”§ åŸºç¡€è¿é€šæ€§æµ‹è¯•**

```bash
# ICMP pingæµ‹è¯•
ping -c 4 8.8.8.8
ping -c 4 114.114.114.114
ping -c 4 1.1.1.1

# ç»“æœåˆ†æ
64 bytes from 8.8.8.8: icmp_seq=1 ttl=116 time=15.2 ms
# timeå€¼è¡¨ç¤ºå»¶è¿Ÿï¼Œæ­£å¸¸åº”åœ¨100msä»¥å†…
```

**ğŸ“¡ ç«¯å£å¯è¾¾æ€§æµ‹è¯•**

```bash
# TCPæ–¹å¼æµ‹è¯•DNSç«¯å£ï¼ˆ53ï¼‰
telnet 8.8.8.8 53
# è¿æ¥æˆåŠŸä¼šæ˜¾ç¤ºï¼šConnected to 8.8.8.8

# UDPæ–¹å¼æµ‹è¯•ï¼ˆDNSä¸»è¦ä½¿ç”¨UDPï¼‰
nc -u -v 8.8.8.8 53
# æˆåŠŸä¼šæ˜¾ç¤ºï¼šConnection to 8.8.8.8 53 port [udp/domain] succeeded!
```

### 7.2 DNSæœåŠ¡è´¨é‡æµ‹è¯•


**âš¡ å“åº”æ—¶é—´æµ‹è¯•**

```bash
# ä½¿ç”¨digæµ‹è¯•å“åº”æ—¶é—´
$ dig www.example.com | grep "Query time"
;; Query time: 23 msec

# æ‰¹é‡æµ‹è¯•å¤šä¸ªDNSæœåŠ¡å™¨
for dns in 8.8.8.8 114.114.114.114 1.1.1.1; do
    echo "=== Testing $dns ==="
    dig @$dns www.example.com | grep "Query time"
done
```

**ğŸ“Š DNSæœåŠ¡å™¨æ€§èƒ½å¯¹æ¯”**

| DNSæœåŠ¡å™¨ | **æœåŠ¡å•†** | **å…¸å‹å»¶è¿Ÿ** | **ç‰¹ç‚¹** |
|-----------|-----------|-------------|----------|
| `8.8.8.8` | Google | `20-50ms` | å…¨çƒæœåŠ¡ï¼Œç¨³å®šæ€§å¥½ |
| `114.114.114.114` | ç”µä¿¡ | `10-30ms` | å›½å†…è®¿é—®é€Ÿåº¦å¿« |
| `1.1.1.1` | Cloudflare | `15-40ms` | æ³¨é‡éšç§ä¿æŠ¤ |
| `223.5.5.5` | é˜¿é‡Œäº‘ | `10-25ms` | å›½å†…ä¼˜åŒ– |

### 7.3 é˜²ç«å¢™å’Œè·¯ç”±æµ‹è¯•


**ğŸ” è·¯ç”±è·Ÿè¸ªåˆ†æ**

```bash
# è·Ÿè¸ªåˆ°DNSæœåŠ¡å™¨çš„ç½‘ç»œè·¯å¾„
traceroute 8.8.8.8
# æˆ–è€…ä½¿ç”¨mtræä¾›æ›´è¯¦ç»†ä¿¡æ¯
mtr -r -c 10 8.8.8.8
```

**ğŸ›¡ï¸ é˜²ç«å¢™æ£€æŸ¥**

```bash
# æ£€æŸ¥æœ¬åœ°é˜²ç«å¢™è§„åˆ™
sudo iptables -L | grep -i dns
sudo ufw status

# ä¸´æ—¶å…è®¸DNSæµé‡
sudo iptables -A OUTPUT -p udp --dport 53 -j ACCEPT
sudo iptables -A INPUT -p udp --sport 53 -j ACCEPT
```

---

## 8. ğŸ” è§£æè·¯å¾„è·Ÿè¸ªåˆ†æ


### 8.1 DNSè§£æè·¯å¾„åŸç†


DNSè§£æè¿‡ç¨‹å°±åƒæŸ¥æ‰¾ä¸€æœ¬å·¨å¤§çš„åˆ†çº§ç”µè¯ç°¿ï¼Œéœ€è¦ä»æœ€é«˜çº§åˆ«å¼€å§‹é€çº§æŸ¥æ‰¾ã€‚

**ğŸ“š DNSå±‚æ¬¡ç»“æ„å›¾**

```
DNSå±‚æ¬¡ç»“æ„ï¼š

          æ ¹åŸŸ(.)
         /    |    \
      .com   .org   .cn      â† é¡¶çº§åŸŸ(TLD)
       |      |      |
   example  github  baidu    â† äºŒçº§åŸŸ
       |      |      |
     www    www    www       â† ä¸‰çº§åŸŸ(ä¸»æœºå)
```

**ğŸ”„ å®Œæ•´è§£ææµç¨‹**

```
æŸ¥è¯¢www.example.comçš„è§£æè¿‡ç¨‹ï¼š

1. æœ¬åœ°DNSç¼“å­˜ â†’ æœªæ‰¾åˆ°
2. é€’å½’DNSæœåŠ¡å™¨ â†’ å¼€å§‹è¿­ä»£æŸ¥è¯¢
3. æ ¹æœåŠ¡å™¨(.) â†’ è¿”å›.comæœåŠ¡å™¨åœ°å€
4. .comæœåŠ¡å™¨ â†’ è¿”å›example.comæœåŠ¡å™¨åœ°å€  
5. example.comæœåŠ¡å™¨ â†’ è¿”å›wwwçš„Aè®°å½•
6. è¿”å›ç»“æœç»™å®¢æˆ·ç«¯
```

### 8.2 ä½¿ç”¨digè¿½è¸ªè§£æè·¯å¾„


**ğŸ” å®Œæ•´è·¯å¾„è¿½è¸ª**

```bash
# è¿½è¸ªå®Œæ•´çš„DNSè§£æè¿‡ç¨‹
$ dig +trace www.example.com

; <<>> DiG 9.16.1 <<>> +trace www.example.com
;; global options: +cmd
.                       518400  IN      NS      a.root-servers.net.
.                       518400  IN      NS      b.root-servers.net.
[... å…¶ä»–æ ¹æœåŠ¡å™¨ ...]

;; Received 1097 bytes from 8.8.8.8#53(8.8.8.8) in 23 ms

com.                    172800  IN      NS      a.gtld-servers.net.
com.                    172800  IN      NS      b.gtld-servers.net.
[... å…¶ä»–.comæœåŠ¡å™¨ ...]

;; Received 1173 bytes from 198.41.0.4#53(a.root-servers.net) in 145 ms

example.com.            172800  IN      NS      ns1.example.com.
example.com.            172800  IN      NS      ns2.example.com.

;; Received 179 bytes from 192.12.94.30#53(e.gtld-servers.net) in 89 ms

www.example.com.        300     IN      A       93.184.216.34

;; Received 62 bytes from 199.43.135.53#53(ns2.example.com) in 78 ms
```

### 8.3 åˆ†æè§£æè·¯å¾„é—®é¢˜


**âš ï¸ å¸¸è§è·¯å¾„é—®é¢˜**

```
è§£æè·¯å¾„ä¸­æ–­çš„åŸå› ï¼š
â€¢ æŸçº§DNSæœåŠ¡å™¨æ— å“åº”
â€¢ DNSè®°å½•é…ç½®é”™è¯¯
â€¢ ç½‘ç»œè·¯ç”±é—®é¢˜
â€¢ æƒå¨æœåŠ¡å™¨æ•…éšœ
```

**ğŸ”§ é€çº§è¯Šæ–­æ–¹æ³•**

```bash
# ç¬¬ä¸€æ­¥ï¼šæµ‹è¯•æ ¹æœåŠ¡å™¨
dig . NS

# ç¬¬äºŒæ­¥ï¼šæµ‹è¯•é¡¶çº§åŸŸæœåŠ¡å™¨
dig com. NS

# ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•æƒå¨æœåŠ¡å™¨
dig example.com. NS

# ç¬¬å››æ­¥ï¼šç›´æ¥æŸ¥è¯¢æƒå¨æœåŠ¡å™¨
dig @ns1.example.com www.example.com
```

### 8.4 æ€§èƒ½åˆ†æå’Œä¼˜åŒ–


**ğŸ“Š è§£ææ€§èƒ½åˆ†æ**

```bash
# åˆ†ææ¯ä¸€æ­¥çš„å“åº”æ—¶é—´
dig +trace +stats www.example.com

# æµ‹è¯•ä¸åŒæŸ¥è¯¢ç±»å‹çš„æ€§èƒ½
for type in A AAAA MX NS; do
    echo "=== $type Record ==="
    time dig www.example.com $type
done
```

**âš¡ ä¼˜åŒ–å»ºè®®**

```
DNSè§£æä¼˜åŒ–ç­–ç•¥ï¼š
â€¢ ä½¿ç”¨å°±è¿‘çš„DNSæœåŠ¡å™¨
â€¢ å¯ç”¨æœ¬åœ°DNSç¼“å­˜
â€¢ é…ç½®å¤šä¸ªå¤‡ç”¨DNSæœåŠ¡å™¨
â€¢ ç›‘æ§DNSè§£ææ€§èƒ½
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å·¥å…·é€‰æ‹©æŒ‡å—


**ğŸ› ï¸ DNSå·¥å…·å¯¹æ¯”æ€»ç»“**

| å·¥å…· | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|-------------|---------|---------|
| `nslookup` | åŸºç¡€æŸ¥è¯¢ | ç®€å•æ˜“ç”¨ï¼Œäº¤äº’æ¨¡å¼ | è¾“å‡ºæ ¼å¼è€æ—§ |
| `dig` | ä¸“ä¸šè¯Šæ–­ | åŠŸèƒ½å¼ºå¤§ï¼Œè¾“å‡ºè¯¦ç»† | å­¦ä¹ æ›²çº¿ç¨é™¡ |
| `host` | è„šæœ¬ç¼–ç¨‹ | è¾“å‡ºç®€æ´ï¼Œå¿«é€ŸæŸ¥è¯¢ | åŠŸèƒ½ç›¸å¯¹ç®€å• |
| `resolvectl` | ç³»ç»Ÿç®¡ç† | ç³»ç»Ÿé›†æˆåº¦é«˜ | ä»…é™systemdç³»ç»Ÿ |

### 9.2 æ•…éšœæ’æŸ¥æ€è·¯


**ğŸ¯ æ ‡å‡†æ’æŸ¥æµç¨‹**

```
DNSæ•…éšœæ’æŸ¥çš„é»„é‡‘æ³•åˆ™ï¼š

ç¬¬ä¸€å±‚ï¼šç½‘ç»œè¿é€šæ€§
â€¢ pingæµ‹è¯•åŸºç¡€è¿é€šæ€§
â€¢ æ£€æŸ¥DNSç«¯å£å¯è¾¾æ€§

ç¬¬äºŒå±‚ï¼šDNSé…ç½®
â€¢ éªŒè¯/etc/resolv.conf
â€¢ æ£€æŸ¥systemd-resolvedçŠ¶æ€

ç¬¬ä¸‰å±‚ï¼šè§£ææµ‹è¯•
â€¢ ä½¿ç”¨å¤šç§å·¥å…·å¯¹æ¯”æµ‹è¯•
â€¢ åˆ†æè§£æè·¯å¾„å’Œæ—¶é—´

ç¬¬å››å±‚ï¼šæ·±åº¦åˆ†æ
â€¢ è¿½è¸ªå®Œæ•´è§£æè¿‡ç¨‹
â€¢ å¯¹æ¯”ä¸åŒDNSæœåŠ¡å™¨
```

### 9.3 å®ç”¨è¯Šæ–­æŠ€å·§


**ğŸ’¡ é«˜æ•ˆè¯Šæ–­æ–¹æ³•**

```bash
# å¿«é€Ÿå¥åº·æ£€æŸ¥è„šæœ¬
dns_health_check() {
    echo "=== DNS Health Check ==="
    echo "1. Network connectivity:"
    ping -c 2 8.8.8.8 > /dev/null && echo "âœ“ Network OK" || echo "âœ— Network Failed"
    
    echo "2. DNS resolution:"
    nslookup www.baidu.com > /dev/null && echo "âœ“ DNS OK" || echo "âœ— DNS Failed"
    
    echo "3. DNS server response time:"
    dig www.baidu.com | grep "Query time"
}
```

**ğŸ”§ å¸¸ç”¨æ•…éšœè§£å†³æ–¹æ¡ˆ**

```
å¿«é€Ÿä¿®å¤å¸¸è§DNSé—®é¢˜ï¼š

1. è§£æå¤±è´¥
sudo systemctl restart systemd-resolved
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf

2. è§£æç¼“æ…¢  
sudo resolvectl flush-caches
dig +short www.example.com

3. é—´æ­‡æ€§æ•…éšœ
é…ç½®å¤šä¸ªDNSæœåŠ¡å™¨ï¼Œå¢åŠ å†—ä½™

4. ä¼ä¸šç½‘ç»œé—®é¢˜
æ£€æŸ¥ä»£ç†è®¾ç½®å’Œå†…éƒ¨DNSé…ç½®
```

### 9.4 æœ€ä½³å®è·µå»ºè®®


**ğŸš€ DNSç®¡ç†æœ€ä½³å®è·µ**

- **ç›‘æ§é…ç½®**ï¼šå®šæœŸæ£€æŸ¥DNSé…ç½®æ–‡ä»¶
- **æ€§èƒ½æµ‹è¯•**ï¼šå‘¨æœŸæ€§æµ‹è¯•DNSå“åº”æ—¶é—´
- **å¤‡ä»½æ–¹æ¡ˆ**ï¼šé…ç½®å¤šä¸ªå¯é çš„DNSæœåŠ¡å™¨
- **å®‰å…¨è€ƒè™‘**ï¼šä½¿ç”¨æ”¯æŒDNSSECçš„DNSæœåŠ¡å™¨
- **æ–‡æ¡£è®°å½•**ï¼šä¿æŒDNSé…ç½®å˜æ›´çš„è¯¦ç»†è®°å½•

**æ ¸å¿ƒè®°å¿†**ï¼š
- DNSæ•…éšœæ’æŸ¥è¦ç³»ç»ŸåŒ–ï¼Œä»ç½‘ç»œåˆ°é…ç½®å±‚å±‚æ£€æŸ¥
- ç†Ÿç»ƒæŒæ¡dig/nslookup/hostä¸‰å¤§å·¥å…·çš„ç‰¹ç‚¹å’Œç”¨æ³•
- ç†è§£DNSè§£æçš„å®Œæ•´è·¯å¾„ï¼Œæœ‰åŠ©äºå¿«é€Ÿå®šä½é—®é¢˜
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œè‰¯å¥½çš„DNSé…ç½®å’Œç›‘æ§æ˜¯å…³é”®