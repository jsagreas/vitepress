---
title: 3、IPv6网络配置基础
---
## 📚 目录

1. [IPv6网络配置概述](#1-ipv6网络配置概述)
2. [IPv6网络接口配置命令](#2-ipv6网络接口配置命令)
3. [静态IPv6地址配置](#3-静态ipv6地址配置)
4. [自动配置管理](#4-自动配置管理)
5. [网络接口状态查看](#5-网络接口状态查看)
6. [邻居发现协议配置](#6-邻居发现协议配置)
7. [配置文件与持久化](#7-配置文件与持久化)
8. [实际应用场景](#8-实际应用场景)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🌐 IPv6网络配置概述


### 1.1 什么是IPv6网络配置


**简单理解**：就像给你的电脑在网络上分配一个新的"门牌号"，只不过这个门牌号比以前的IPv4更长、更复杂。

```
IPv4地址像这样：192.168.1.100（4组数字）
IPv6地址像这样：2001:db8::1（8组16进制数字，可以简化）
```

**为什么需要IPv6配置**：
- 📊 **地址不够用**：IPv4地址快用完了（43亿个）
- 🔒 **安全性更好**：IPv6内置了更多安全特性
- 🚀 **性能更优**：减少了网络地址转换的开销
- 🌍 **面向未来**：物联网设备需要更多IP地址

### 1.2 IPv6配置的基本概念


**核心理解**：
```
传统IPv4配置：   现代IPv6配置：
手动设置IP      →  可以自动获取
需要子网掩码    →  用前缀长度表示
需要网关        →  邻居发现协议自动找到
```

**IPv6的三种配置方式**：
- 🔧 **静态配置**：手动指定地址（像填表格一样）
- 🤖 **自动配置**：系统自动获取地址（像自动填表）
- 🔄 **DHCPv6**：从服务器获取地址（像从柜台领号）

---

## 2. ⚙️ IPv6网络接口配置命令


### 2.1 基本接口管理命令


**查看网络接口**：
```bash
# 查看所有网络接口
ip link show

# 查看特定接口（比如eth0）
ip link show eth0
```

**启用和禁用接口**：
```bash
# 启用网络接口
sudo ip link set eth0 up

# 禁用网络接口  
sudo ip link set eth0 down
```

💡 **通俗解释**：`ip link` 就像是查看和控制网络"插头"的命令，`up`是插上，`down`是拔掉。

### 2.2 IPv6地址配置命令


**添加IPv6地址**：
```bash
# 给接口添加IPv6地址
sudo ip -6 addr add 2001:db8::100/64 dev eth0

# 添加临时地址（重启后消失）
sudo ip -6 addr add 2001:db8::200/64 dev eth0 temporary
```

**删除IPv6地址**：
```bash
# 删除指定IPv6地址
sudo ip -6 addr del 2001:db8::100/64 dev eth0

# 清空接口所有IPv6地址
sudo ip -6 addr flush dev eth0
```

**🔍 命令详解**：
- `-6`：表示IPv6协议
- `addr`：地址管理
- `add/del`：添加/删除
- `dev eth0`：指定网络接口
- `/64`：前缀长度（相当于IPv4的子网掩码）

### 2.3 实用配置技巧


| 操作场景 | 命令示例 | 说明 |
|---------|---------|------|
| 🏠 **家庭网络** | `ip -6 addr add 2001:db8:home::10/64 dev eth0` | 配置家庭内网地址 |
| 🏢 **办公网络** | `ip -6 addr add 2001:db8:office::20/64 dev eth0` | 配置办公网地址 |
| 🧪 **测试环境** | `ip -6 addr add fd00::1/64 dev eth0` | 使用本地唯一地址 |

---

## 3. 🔧 静态IPv6地址配置


### 3.1 什么是静态配置


**简单理解**：就像给你家门牌号码一样，你手动指定一个固定的IPv6地址，这个地址不会自动变化。

**静态配置的优点**：
- ✅ **地址固定**：IP地址不会变化，便于管理
- ✅ **无依赖**：不需要DHCP服务器
- ✅ **可预测**：网络规划时地址分配清晰

**静态配置的缺点**：
- ❌ **手动维护**：需要人工管理每个设备的地址
- ❌ **容易冲突**：可能出现地址重复的问题

### 3.2 静态配置步骤


**步骤一：选择合适的IPv6地址**
```
地址规划示例：
网络前缀：2001:db8:1000::/48
子网分配：
- 服务器网段：2001:db8:1000:1::/64
- 客户端网段：2001:db8:1000:2::/64
- 管理网段：  2001:db8:1000:100::/64
```

**步骤二：配置网络接口**
```bash
# 配置服务器地址
sudo ip -6 addr add 2001:db8:1000:1::10/64 dev eth0

# 配置默认网关
sudo ip -6 route add default via 2001:db8:1000:1::1 dev eth0
```

**步骤三：验证配置**
```bash
# 查看配置结果
ip -6 addr show dev eth0

# 测试网络连通性
ping6 2001:db8:1000:1::1
```

### 3.3 静态配置最佳实践


**地址规划建议**：
```
服务器地址：    使用::10, ::20, ::30 等规整地址
网关地址：      统一使用::1 作为网关
DNS服务器：     使用::53 或参考公共DNS
备用地址：      预留::100-::200 段作为备用
```

⚠️ **注意事项**：
- 确保地址在网络中唯一
- 记录所有静态地址分配
- 定期检查地址冲突

---

## 4. 🤖 自动配置管理


### 4.1 IPv6自动配置原理


**通俗解释**：IPv6自动配置就像"智能插座"，插上网线后，设备会自动和路由器"握手"，获取合适的网络地址。

**自动配置的工作流程**：
```
设备启动
    ↓
发送路由器请求
    ↓
收到路由器通告
    ↓
生成链路本地地址
    ↓
生成全局地址
    ↓
配置完成
```

### 4.2 启用自动配置


**启用SLAAC（无状态地址自动配置）**：
```bash
# 启用IPv6自动配置
sudo sysctl -w net.ipv6.conf.eth0.autoconf=1

# 启用IPv6转发（如果需要）
sudo sysctl -w net.ipv6.conf.all.forwarding=0

# 启用接受路由器通告
sudo sysctl -w net.ipv6.conf.eth0.accept_ra=1
```

**重启网络接口应用配置**：
```bash
# 重启接口
sudo ip link set eth0 down
sudo ip link set eth0 up

# 或者重启网络服务
sudo systemctl restart networking
```

### 4.3 禁用自动配置


**完全禁用IPv6自动配置**：
```bash
# 禁用自动配置
sudo sysctl -w net.ipv6.conf.eth0.autoconf=0

# 禁用接受路由器通告
sudo sysctl -w net.ipv6.conf.eth0.accept_ra=0

# 禁用重复地址检测
sudo sysctl -w net.ipv6.conf.eth0.dad_transmits=0
```

### 4.4 自动配置vs手动配置对比


| 特性 | 自动配置 | 手动配置 |
|------|---------|---------|
| 🔧 **配置难度** | `简单` | `需要专业知识` |
| 🏠 **家庭环境** | `推荐使用` | `非必需` |
| 🏢 **企业环境** | `看情况` | `更好控制` |
| 🔒 **安全性** | `中等` | `可控性强` |
| 📊 **管理复杂度** | `低` | `高` |

---

## 5. 📊 网络接口状态查看


### 5.1 基本状态查看命令


**查看所有IPv6地址**：
```bash
# 详细查看所有IPv6地址
ip -6 addr show

# 查看特定接口的IPv6地址
ip -6 addr show dev eth0

# 简洁显示IPv6地址
ip -6 addr show | grep inet6
```

**查看IPv6路由表**：
```bash
# 查看IPv6路由表
ip -6 route show

# 查看默认路由
ip -6 route show default
```

### 5.2 详细状态信息解读


**地址状态标识**：
```bash
# 示例输出
inet6 2001:db8::1/64 scope global 
inet6 fe80::a00:27ff:fe4e:66a1/64 scope link
inet6 ::1/128 scope host
```

**状态解释**：
- 🌍 **global**：全局地址（可以访问互联网）
- 🔗 **link**：链路本地地址（只能在本地网络使用）
- 🏠 **host**：主机地址（回环地址，只能本机访问）

### 5.3 高级状态检查


**检查邻居发现缓存**：
```bash
# 查看IPv6邻居表
ip -6 neighbor show

# 查看特定接口的邻居
ip -6 neighbor show dev eth0
```

**检查网络连通性**：
```bash
# ping IPv6地址
ping6 2001:db8::1

# 追踪IPv6路由
traceroute6 2001:4860:4860::8888

# 使用域名测试IPv6连接
ping6 google.com
```

📋 **状态检查清单**：
- [x] IPv6地址是否正确分配
- [x] 默认路由是否存在
- [x] 邻居发现是否正常工作
- [x] 网络连通性测试通过

---

## 6. 🔍 邻居发现协议配置


### 6.1 什么是邻居发现协议


**通俗解释**：邻居发现协议（NDP）就像IPv6网络中的"物业管理"，帮助设备找到网络中的其他设备，就像物业帮你找到邻居一样。

**邻居发现协议的作用**：
- 🏠 **地址解析**：找到其他设备的物理地址（MAC地址）
- 🚪 **网关发现**：自动找到网络出口（默认网关）
- 📢 **路由器通告**：告诉设备网络配置信息
- 🔍 **重复地址检测**：确保地址不会重复

### 6.2 邻居发现协议配置


**基本NDP参数配置**：
```bash
# 启用邻居发现
sudo sysctl -w net.ipv6.conf.eth0.accept_ra=1

# 配置邻居发现重试次数
sudo sysctl -w net.ipv6.conf.eth0.dad_transmits=3

# 配置路由器请求间隔（秒）
sudo sysctl -w net.ipv6.conf.eth0.router_solicitation_interval=4

# 配置最大路由器请求次数
sudo sysctl -w net.ipv6.conf.eth0.router_solicitations=3
```

**手动添加邻居条目**：
```bash
# 添加静态邻居条目
sudo ip -6 neighbor add 2001:db8::1 lladdr 00:11:22:33:44:55 dev eth0

# 删除邻居条目
sudo ip -6 neighbor del 2001:db8::1 dev eth0

# 清空邻居表
sudo ip -6 neighbor flush dev eth0
```

### 6.3 NDP故障排除


**常见问题和解决方法**：

| 问题现象 | 可能原因 | 解决方法 |
|---------|---------|---------|
| 🚫 **无法获取IPv6地址** | 路由器通告被禁用 | `sysctl -w net.ipv6.conf.eth0.accept_ra=1` |
| 🔄 **地址冲突** | 重复地址检测失败 | 检查网络中是否有相同地址 |
| 🌐 **无法访问外网** | 默认路由缺失 | 手动添加默认路由 |

**NDP调试命令**：
```bash
# 查看NDP统计信息
cat /proc/net/snmp6 | grep Icmp6

# 监控NDP数据包
sudo tcpdump -i eth0 icmp6

# 发送路由器请求
sudo rdisc6 eth0
```

---

## 7. 📁 配置文件与持久化


### 7.1 网络配置文件位置


**不同Linux发行版的配置文件**：

**Ubuntu/Debian系统**：
```bash
# 主配置文件
/etc/netplan/01-network-config.yaml

# 传统配置文件（较老版本）
/etc/network/interfaces
```

**CentOS/RHEL系统**：
```bash
# 网络接口配置
/etc/sysconfig/network-scripts/ifcfg-eth0

# 全局网络配置
/etc/sysconfig/network
```

**通用系统配置**：
```bash
# 内核参数配置
/etc/sysctl.conf

# DNS配置
/etc/resolv.conf
```

### 7.2 配置文件修改示例


**Ubuntu Netplan配置**：
```yaml
# /etc/netplan/01-network-config.yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      addresses:
        - 2001:db8::100/64
      gateway6: 2001:db8::1
      nameservers:
        addresses:
          - 2001:4860:4860::8888
          - 2001:4860:4860::8844
      accept-ra: false
```

**CentOS网络配置**：
```bash
# /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
BOOTPROTO=none
ONBOOT=yes
IPV6INIT=yes
IPV6ADDR=2001:db8::100/64
IPV6_DEFAULTGW=2001:db8::1
IPV6_AUTOCONF=no
```

### 7.3 配置持久化操作


**使配置永久生效**：
```bash
# Ubuntu系统
sudo netplan apply

# CentOS系统
sudo systemctl restart network

# 通用方法：重启网络服务
sudo systemctl restart networking
```

**内核参数持久化**：
```bash
# 编辑sysctl配置文件
sudo nano /etc/sysctl.conf

# 添加IPv6相关配置
net.ipv6.conf.all.forwarding=0
net.ipv6.conf.eth0.autoconf=1
net.ipv6.conf.eth0.accept_ra=1

# 应用配置
sudo sysctl -p
```

⚠️ **配置注意事项**：
- 修改配置文件前先备份
- 测试配置无误后再应用
- 确保重启后配置仍然有效

---

## 8. 🛠️ 实际应用场景


### 8.1 家庭网络IPv6配置


**场景描述**：家里的路由器支持IPv6，需要给电脑配置IPv6地址上网。

**配置步骤**：
```bash
# 1. 启用自动配置
sudo sysctl -w net.ipv6.conf.eth0.autoconf=1
sudo sysctl -w net.ipv6.conf.eth0.accept_ra=1

# 2. 重启网络接口
sudo ip link set eth0 down
sudo ip link set eth0 up

# 3. 验证配置
ip -6 addr show dev eth0
ping6 google.com
```

**预期结果**：
- 获得运营商分配的全局IPv6地址
- 能够访问IPv6网站
- 与IPv4双栈共存

### 8.2 服务器IPv6配置


**场景描述**：配置Web服务器支持IPv6访问。

**配置方案**：
```bash
# 1. 配置静态IPv6地址
sudo ip -6 addr add 2001:db8:web::10/64 dev eth0

# 2. 配置默认路由
sudo ip -6 route add default via 2001:db8:web::1

# 3. 配置防火墙允许IPv6访问
sudo ip6tables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo ip6tables -A INPUT -p tcp --dport 443 -j ACCEPT

# 4. 配置Web服务器监听IPv6
# 在Apache/Nginx配置中添加IPv6监听
```

### 8.3 企业网络IPv6规划


**网络规划示例**：
```
企业IPv6地址分配：
2001:db8:company::/48 (企业总前缀)
│
├── 2001:db8:company:1::/64  (服务器网段)
├── 2001:db8:company:10::/64 (办公网段)
├── 2001:db8:company:20::/64 (访客网段)
└── 2001:db8:company:100::/64 (管理网段)
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 IPv6配置基础：理解IPv6地址格式和配置原理
🔸 静态vs自动：掌握两种配置方式的适用场景
🔸 邻居发现协议：了解IPv6网络自动发现机制
🔸 配置持久化：确保重启后配置仍然有效
🔸 故障排除：掌握基本的诊断和解决方法
```

### 9.2 关键命令速查


| 功能 | 命令 | 说明 |
|------|------|------|
| 🔍 **查看地址** | `ip -6 addr show` | 显示所有IPv6地址 |
| ➕ **添加地址** | `ip -6 addr add 地址/前缀 dev 接口` | 配置IPv6地址 |
| 🗑️ **删除地址** | `ip -6 addr del 地址/前缀 dev 接口` | 删除IPv6地址 |
| 🌐 **查看路由** | `ip -6 route show` | 显示IPv6路由表 |
| 🔄 **启用自动配置** | `sysctl -w net.ipv6.conf.接口.autoconf=1` | 开启SLAAC |
| 🔧 **查看邻居** | `ip -6 neighbor show` | 显示邻居发现表 |

### 9.3 配置最佳实践


**🏠 家庭用户推荐**：
- 使用自动配置（SLAAC）
- 确保路由器支持IPv6
- 定期检查连通性

**🏢 企业用户推荐**：
- 制定IPv6地址规划
- 使用静态配置重要服务器
- 配置DNS解析IPv6地址
- 实施IPv6安全策略

**🚨 安全注意事项**：
- 配置IPv6防火墙规则
- 禁用不必要的自动配置
- 监控IPv6网络流量
- 定期更新系统补丁

### 9.4 故障排除清单


**网络不通时的检查步骤**：
1. ✅ 检查网络接口是否启用
2. ✅ 验证IPv6地址是否正确配置
3. ✅ 确认默认路由是否存在
4. ✅ 测试邻居发现是否正常
5. ✅ 检查防火墙规则
6. ✅ 验证DNS解析功能

**常用诊断命令**：
```bash
# 基础连通性测试
ping6 ::1                    # 测试本机回环
ping6 fe80::1%eth0          # 测试链路本地
ping6 2001:4860:4860::8888  # 测试互联网连接

# 高级诊断
traceroute6 目标地址         # 路由追踪
tcpdump -i eth0 ip6         # 抓包分析
ss -6 -tuln                 # 查看IPv6监听端口
```

**核心记忆**：
- IPv6配置重在理解地址类型和作用域
- 自动配置适合简单环境，静态配置适合服务器
- 邻居发现协议是IPv6网络的核心机制
- 配置持久化是生产环境的必要步骤
- 双栈环境下IPv4和IPv6可以并存