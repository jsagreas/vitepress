---
title: 9、网络路由基础配置
---
## 📚 目录

1. [路由表概念与结构](#1-路由表概念与结构)
2. [默认网关配置方法](#2-默认网关配置方法)
3. [静态路由添加删除](#3-静态路由添加删除)
4. [路由优先级与度量值](#4-路由优先级与度量值)
5. [多网卡路由策略](#5-多网卡路由策略)
6. [路由缓存管理](#6-路由缓存管理)
7. [路由表查看与分析](#7-路由表查看与分析)
8. [路由故障诊断方法](#8-路由故障诊断方法)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🛣️ 路由表概念与结构


### 1.1 什么是路由表


**路由表**就像是网络世界的"导航地图"，告诉数据包该往哪个方向走才能到达目标地址。

> 💡 **通俗理解**：想象你要寄快递，路由表就是快递公司的派送表，上面写着"发往北京的包裹走A门"、"发往上海的包裹走B门"

**路由表的作用**：
- 🎯 **决定数据流向**：告诉系统数据包该从哪个网络接口发出
- 🔍 **寻找最佳路径**：在多条路径中选择最合适的
- 🚪 **网关指引**：指定到达远程网络需要经过哪个网关

### 1.2 路由表的基本结构


```
典型路由表结构：
┌─────────────────┬──────────────┬─────────────┬─────────────┬──────────┐
│   目标网络      │   子网掩码   │   网关地址  │  网络接口   │  度量值  │
├─────────────────┼──────────────┼─────────────┼─────────────┼──────────┤
│ 192.168.1.0     │ 255.255.255.0│  0.0.0.0    │   eth0      │    0     │
│ 0.0.0.0         │ 0.0.0.0      │192.168.1.1  │   eth0      │    1     │
│ 10.0.0.0        │ 255.0.0.0    │192.168.1.1  │   eth0      │    1     │
└─────────────────┴──────────────┴─────────────┴─────────────┴──────────┘
```

**字段含义解释**：

**目标网络**：
- 要到达的网络地址
- `0.0.0.0` 表示默认路由（所有其他网络）
- 可以是具体网络段如 `192.168.1.0`

**子网掩码**：
- 确定网络部分和主机部分的分界线
- `255.255.255.0` 表示前24位是网络位
- `0.0.0.0` 配合目标网络 `0.0.0.0` 表示匹配所有地址

**网关地址**：
- 下一跳的路由器地址
- `0.0.0.0` 表示直连网络，不需要网关
- 具体IP表示需要通过该网关转发

**网络接口**：
- 数据包从哪个网卡发出
- 如 `eth0`、`wlan0` 等

### 1.3 路由匹配原理


```
路由匹配过程示例：

目标IP: 192.168.1.100
┌─────────────────────────────────────┐
│ 1. 检查直连网络                      │
│    192.168.1.0/24 匹配! ✓           │
│                                     │
│ 2. 如果没有匹配，检查静态路由        │
│                                     │
│ 3. 最后使用默认路由                  │
│    0.0.0.0/0 (兜底路由)            │
└─────────────────────────────────────┘
```

> 📖 **核心概念**：路由匹配遵循"最长前缀匹配"原则，即选择子网掩码最长（最具体）的路由条目

---

## 2. 🚪 默认网关配置方法


### 2.1 默认网关的作用


**默认网关**是网络的"大门"，当系统不知道数据包该往哪里发送时，就会发给默认网关。

```
网络架构示意：
    本地计算机
    192.168.1.100
         │
         │ 本地网络
         │ 192.168.1.0/24
         │
    ┌────▼────┐      互联网
    │ 路由器   │ ←→ 广阔世界
    │192.168.1.1│
    └─────────┘
    (默认网关)
```

> ⚠️ **重要理解**：没有默认网关，你的电脑就像是没有门的房间，只能和同一网段的设备通信，无法访问外网

### 2.2 查看当前默认网关


```bash
# 方法1：使用route命令
route -n

# 方法2：使用ip命令（推荐）
ip route show

# 方法3：查看网关信息
ip route | grep default
```

**输出解读示例**：
```
default via 192.168.1.1 dev eth0 proto dhcp metric 100
│      │   │             │   │     │      │       │
│      │   │             │   │     │      │       └─ 度量值
│      │   │             │   │     │      └─ 协议类型
│      │   │             │   │     └─ 网络接口
│      │   │             │   └─ 设备名
│      │   │             └─ 网关IP地址
│      │   └─ 通过的意思
│      └─ 经由、通过
└─ 默认路由
```

### 2.3 配置默认网关


**临时配置（重启后失效）**：
```bash
# 添加默认网关
ip route add default via 192.168.1.1

# 删除默认网关
ip route del default

# 修改默认网关（先删后加）
ip route del default
ip route add default via 192.168.1.254
```

**永久配置方法**：

```bash
# CentOS/RHEL 系统
# 编辑网卡配置文件
vim /etc/sysconfig/network-scripts/ifcfg-eth0

# 添加或修改以下行
GATEWAY=192.168.1.1
```

```bash
# Ubuntu/Debian 系统
# 编辑网络配置
vim /etc/netplan/01-netcfg.yaml

# 示例配置
network:
  version: 2
  ethernets:
    eth0:
      addresses: [192.168.1.100/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
```

> 🔧 **实践提示**：修改网络配置后，记得重启网络服务或重新加载配置使其生效

---

## 3. ➕ 静态路由添加删除


### 3.1 静态路由的应用场景


**什么时候需要静态路由**：
- 🏢 **多网段环境**：公司内部有多个VLAN需要互通
- 🔒 **安全考虑**：特定网络只允许通过指定路径访问
- ⚡ **性能优化**：为某些重要流量指定更快的路径
- 🛠️ **网络测试**：临时改变数据流向进行故障诊断

### 3.2 静态路由配置语法


```bash
# 基本语法
ip route add [目标网络/掩码位数] via [网关IP] dev [网络接口]

# 示例：访问10.0.0.0/8网段通过192.168.1.254网关
ip route add 10.0.0.0/8 via 192.168.1.254 dev eth0
```

**参数解释**：
- `目标网络/掩码位数`：要到达的网络，如 `10.0.0.0/8`
- `via 网关IP`：下一跳路由器的IP地址
- `dev 网络接口`：从哪个网卡发出数据包

### 3.3 常用静态路由操作


**添加路由示例**：
```bash
# 添加到特定网段的路由
ip route add 172.16.0.0/16 via 192.168.1.254

# 添加主机路由（/32表示单个主机）
ip route add 8.8.8.8/32 via 192.168.1.1

# 指定网络接口（不通过网关，直连）
ip route add 192.168.2.0/24 dev eth1
```

**删除路由示例**：
```bash
# 删除特定路由
ip route del 172.16.0.0/16

# 删除主机路由
ip route del 8.8.8.8/32

# 删除所有通过特定网关的路由
ip route flush via 192.168.1.254
```

**批量路由管理**：
```bash
# 保存当前路由表到文件
ip route save > /tmp/routes.backup

# 从文件恢复路由表
ip route restore < /tmp/routes.backup

# 清空所有路由（危险操作！）
ip route flush table main
```

### 3.4 永久保存静态路由


> ⚠️ **注意**：使用 `ip route` 命令添加的路由重启后会丢失，需要写入配置文件才能永久保存

**CentOS/RHEL系统**：
```bash
# 创建路由配置文件
vim /etc/sysconfig/network-scripts/route-eth0

# 文件内容示例
172.16.0.0/16 via 192.168.1.254
10.0.0.0/8 via 192.168.1.254
```

**Ubuntu/Debian系统**：
```bash
# 编辑netplan配置
vim /etc/netplan/01-netcfg.yaml

# 添加路由配置
network:
  version: 2
  ethernets:
    eth0:
      addresses: [192.168.1.100/24]
      gateway4: 192.168.1.1
      routes:
        - to: 172.16.0.0/16
          via: 192.168.1.254
        - to: 10.0.0.0/8
          via: 192.168.1.254
```

---

## 4. 🏆 路由优先级与度量值


### 4.1 理解路由优先级


当到达同一目标有多条路由时，系统需要决定使用哪一条。这就是**路由优先级**的作用。

```
多路径示例：
目标：到达 172.16.0.0/16

路径1: 172.16.0.0/16 via 192.168.1.254 metric 10
路径2: 172.16.0.0/16 via 192.168.1.253 metric 20
路径3: 0.0.0.0/0 via 192.168.1.1 metric 100 (默认路由)

选择规则：
1. 最长前缀匹配（/16 优于 /0）
2. 相同前缀长度时，选择度量值小的
```

### 4.2 度量值的含义


**度量值（Metric）**表示路径的"代价"，数值越小表示路径越好。

**度量值的影响因素**：
- 🛣️ **跳数**：经过的路由器数量
- 🚀 **带宽**：链路的传输速度
- ⏱️ **延迟**：数据传输的时间延迟
- 💰 **成本**：线路的费用考虑

### 4.3 手动设置度量值


```bash
# 添加路由时指定度量值
ip route add 172.16.0.0/16 via 192.168.1.254 metric 10

# 为默认路由设置度量值
ip route add default via 192.168.1.1 metric 100

# 修改现有路由的度量值
ip route change 172.16.0.0/16 via 192.168.1.254 metric 20
```

**度量值选择建议**：

| 连接类型 | **建议度量值** | **说明** |
|---------|---------------|----------|
| 🔌 **直连网络** | `0-10` | `最高优先级，本地网段` |
| 🏠 **内网专线** | `10-50` | `企业内部高速连接` |
| 🌐 **互联网线路** | `50-100` | `主要外网出口` |
| 📱 **备用线路** | `100-200` | `备份连接，故障时使用` |

### 4.4 查看路由优先级


```bash
# 查看所有路由及其度量值
ip route show

# 查看特定目标的所有路由
ip route get 172.16.1.1

# 显示详细的路由信息
ip -d route show
```

**输出示例分析**：
```
172.16.0.0/16 via 192.168.1.254 dev eth0 proto static metric 10
172.16.0.0/16 via 192.168.1.253 dev eth0 proto static metric 20
default via 192.168.1.1 dev eth0 proto dhcp metric 100

解读：
- 到172.16.0.0/16有两条路由，优先使用metric 10的路径
- 默认路由度量值为100，只有在没有更具体路由时才使用
```

---

## 5. 🔀 多网卡路由策略


### 5.1 多网卡场景


在服务器或复杂网络环境中，一台机器可能有多个网络接口：

```
多网卡配置示例：
    ┌─────────────────┐
    │   Linux服务器    │
    │                │
    │  eth0 (内网)    │ ←→ 192.168.1.0/24 (办公网络)
    │  192.168.1.100  │
    │                │
    │  eth1 (外网)    │ ←→ 公网IP (互联网)
    │  公网IP          │
    │                │
    │  eth2 (存储网)   │ ←→ 10.0.0.0/24 (存储网络)
    │  10.0.0.100     │
    └─────────────────┘
```

**多网卡的用途**：
- 🏢 **网络隔离**：内网、外网、管理网分离
- ⚡ **负载均衡**：多条线路分担流量
- 🔒 **安全隔离**：敏感数据走专用网络
- 🛡️ **冗余备份**：主链路故障时自动切换

### 5.2 基于源地址的路由策略


**策略路由**允许根据不同条件选择不同的路由表：

```bash
# 查看路由表列表
ip rule show

# 创建自定义路由表
echo "200 custom_table" >> /etc/iproute2/rt_tables

# 为特定源地址指定路由表
ip rule add from 192.168.1.100 table custom_table

# 在自定义路由表中添加路由
ip route add default via 192.168.1.1 table custom_table
```

### 5.3 多网卡负载均衡


**等价多路径（ECMP）**配置：
```bash
# 添加多个等权重的默认路由
ip route add default \
    nexthop via 192.168.1.1 dev eth0 weight 1 \
    nexthop via 192.168.2.1 dev eth1 weight 1

# 查看负载均衡路由
ip route show | grep nexthop
```

**权重分配示例**：
```bash
# 主线路承担70%流量，备份线路承担30%
ip route add default \
    nexthop via 192.168.1.1 dev eth0 weight 7 \
    nexthop via 192.168.2.1 dev eth1 weight 3
```

### 5.4 网卡绑定（Bonding）


**网卡绑定**将多个物理网卡组合成一个逻辑接口：

```bash
# 安装bonding模块
modprobe bonding

# 创建bond接口
ip link add bond0 type bond mode 802.3ad

# 将物理网卡加入bond
ip link set eth0 master bond0
ip link set eth1 master bond0

# 启用bond接口
ip link set bond0 up
```

**常用绑定模式**：

| 模式 | **名称** | **特点** | **适用场景** |
|------|---------|----------|-------------|
| `0` | **balance-rr** | `轮询发送，负载均衡` | `高吞吐量需求` |
| `1` | **active-backup** | `主备模式，故障切换` | `高可用性需求` |
| `4` | **802.3ad** | `LACP协议，动态聚合` | `交换机支持LACP` |
| `6` | **balance-alb** | `自适应负载均衡` | `无需交换机配置` |

---

## 6. 🧹 路由缓存管理


### 6.1 理解路由缓存


**路由缓存**是系统为了提高性能而临时存储的路由信息，就像浏览器缓存网页一样。

```
路由查找过程：
1. 检查路由缓存 ←─ 如果命中，直接使用（快速）
2. 查询路由表   ←─ 如果缓存miss，查询完整路由表
3. 更新缓存     ←─ 将结果存入缓存供下次使用
```

> 💡 **性能影响**：路由缓存可以将路由查找时间从微秒级降低到纳秒级，特别是在高并发网络环境中效果明显

### 6.2 查看路由缓存


```bash
# 查看路由缓存统计
ip -s route show cache

# 查看特定目标的缓存信息
ip route get 8.8.8.8

# 显示详细的缓存信息
cat /proc/net/rt_cache
```

### 6.3 路由缓存管理


**清空路由缓存**：
```bash
# 清空所有路由缓存
ip route flush cache

# 清空特定网络的缓存
ip route flush cache 192.168.1.0/24

# 清空通过特定网关的缓存
ip route flush cache via 192.168.1.1
```

**缓存参数调优**：
```bash
# 查看当前缓存参数
sysctl net.ipv4.route

# 调整缓存大小（条目数）
sysctl -w net.ipv4.route.max_size=1048576

# 设置缓存过期时间（秒）
sysctl -w net.ipv4.route.gc_timeout=300

# 永久保存设置
echo "net.ipv4.route.max_size = 1048576" >> /etc/sysctl.conf
```

### 6.4 缓存问题排查


**常见缓存问题**：
- 🔄 **路由更新不生效**：缓存中还保存着旧的路由信息
- 💾 **内存占用过高**：缓存条目过多占用系统内存
- ⏰ **连接异常**：缓存的路由已经失效但未更新

**解决方法**：
```bash
# 问题1：强制刷新缓存
ip route flush cache

# 问题2：限制缓存大小
sysctl -w net.ipv4.route.max_size=65536

# 问题3：缩短缓存时间
sysctl -w net.ipv4.route.gc_timeout=60
```

---

## 7. 🔍 路由表查看与分析


### 7.1 基本查看命令


**常用查看命令对比**：

```bash
# 传统route命令（兼容性好）
route -n

# 现代ip命令（功能强大，推荐）
ip route show

# 查看特定协议族
ip -4 route show    # IPv4路由
ip -6 route show    # IPv6路由
```

### 7.2 详细路由信息解读


```bash
# 显示详细信息
ip route show verbose
```

**典型输出解析**：
```
192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.100 metric 100
│              │   │     │      │       │     │    │               │       │
│              │   │     │      │       │     │    │               │       └─ 度量值
│              │   │     │      │       │     │    │               └─ 源地址
│              │   │     │      │       │     │    └─ 作用域(link=直连)
│              │   │     │      │       │     └─ 协议类型(kernel=内核自动)
│              │   │     │      │       └─ 设备接口
│              │   │     │      └─ 网络接口名
│              │   │     └─ 直连设备
│              │   └─ 网络接口
│              └─ 目标网络段
└─ 完整的路由条目
```

**协议类型说明**：
- `kernel`：内核自动生成（如直连网络）
- `static`：手动配置的静态路由
- `dhcp`：DHCP服务器分配的路由
- `boot`：系统启动时的路由

### 7.3 路由表分析技巧


**查找特定路由**：
```bash
# 查看到特定网络的路由
ip route show 172.16.0.0/16

# 测试到特定IP的路由路径
ip route get 8.8.8.8

# 查看默认路由
ip route | grep default
```

**按接口过滤**：
```bash
# 查看特定接口的路由
ip route show dev eth0

# 统计各接口的路由数量
ip route show | awk '{print $3}' | sort | uniq -c
```

**路由表格式化显示**：
```bash
# 表格化显示路由信息
ip route show | column -t

# 只显示网络和网关
ip route show | awk '{print $1 " -> " $3}'
```

### 7.4 路由表导出与备份


```bash
# 导出当前路由表
ip route save > /backup/routes_$(date +%Y%m%d).txt

# 导出为人类可读格式
ip route show > /backup/routes_readable_$(date +%Y%m%d).txt

# 比较两个路由表的差异
diff /backup/routes_old.txt /backup/routes_new.txt
```

---

## 8. 🚨 路由故障诊断方法


### 8.1 常见路由问题


**典型故障症状**：
- 🚫 **无法访问外网**：网页打不开，ping不通外部IP
- 🏠 **内网通信异常**：同事电脑连不上，服务器访问不了
- 🐌 **网络速度慢**：数据传输缓慢，视频卡顿
- 🔄 **连接不稳定**：时好时坏，经常断线

### 8.2 分层诊断方法


**第一步：检查物理连接**
```bash
# 检查网卡状态
ip link show

# 查看网卡统计信息
ip -s link show eth0

# 检查网线连接
ethtool eth0 | grep "Link detected"
```

**第二步：检查网络配置**
```bash
# 查看IP地址配置
ip addr show

# 检查网络接口状态
ip link show | grep UP

# 验证子网掩码正确性
ip route show | grep "scope link"
```

**第三步：测试网络连通性**
```bash
# 测试本机回环
ping 127.0.0.1

# 测试本网段通信
ping 192.168.1.1

# 测试外网连接
ping 8.8.8.8
```

### 8.3 路由追踪诊断


**使用traceroute跟踪路径**：
```bash
# 跟踪到目标的完整路径
traceroute 8.8.8.8

# 使用IP地址显示（不解析域名）
traceroute -n 8.8.8.8

# 限制跳数
traceroute -m 15 8.8.8.8
```

**traceroute输出分析**：
```
traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
 1  192.168.1.1 (192.168.1.1)  1.234 ms  1.123 ms  1.456 ms
 2  10.0.0.1 (10.0.0.1)        5.678 ms  5.432 ms  5.789 ms
 3  * * *
 4  8.8.8.8 (8.8.8.8)          15.234 ms 15.123 ms 15.456 ms

分析：
- 第1跳：本地网关，延迟正常（1ms左右）
- 第2跳：ISP路由器，延迟可接受（5ms左右）  
- 第3跳：显示 * * *，可能是防火墙屏蔽或设备不响应
- 第4跳：最终到达目标，总延迟15ms
```

### 8.4 常用诊断工具


**网络连通性测试**：
```bash
# 基础ping测试
ping -c 4 8.8.8.8

# 大包测试（测试MTU）
ping -s 1472 -c 4 8.8.8.8

# 持续监控连通性
ping -i 5 8.8.8.8 | tee ping_log.txt
```

**端口连通性测试**：
```bash
# 测试TCP端口
telnet 192.168.1.1 80

# 使用nc工具测试
nc -zv 192.168.1.1 22

# 批量端口扫描
nmap -p 1-1000 192.168.1.1
```

**DNS解析测试**：
```bash
# 测试域名解析
nslookup www.baidu.com

# 使用dig工具详细查询
dig www.baidu.com

# 测试反向解析
dig -x 8.8.8.8
```

### 8.5 故障排除流程


```
网络故障排除标准流程：

第1步：确认问题范围
├─ 只有本机有问题？  → 检查本机配置
├─ 整个网段有问题？  → 检查交换机/路由器
└─ 只有特定服务？    → 检查服务配置

第2步：分层诊断
├─ 物理层：网线、网卡、端口指示灯
├─ 数据链路层：交换机端口、VLAN配置
├─ 网络层：IP地址、路由表、防火墙
└─ 应用层：服务状态、端口监听

第3步：逐跳测试
├─ ping 本地回环 (127.0.0.1)
├─ ping 本机IP
├─ ping 网关IP
├─ ping 外网IP
└─ ping 域名

第4步：修复验证
├─ 实施修复方案
├─ 验证问题解决
├─ 记录故障原因
└─ 制定预防措施
```

> 🔧 **实践经验**：90%的网络问题都出现在前3层（物理层、数据链路层、网络层），先检查这些基础设施再考虑复杂的应用层问题

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 路由表：网络数据包的导航地图，决定数据流向
🔸 默认网关：网络的"大门"，访问外网的必经之路
🔸 静态路由：手动配置的固定路径，用于特殊网络需求
🔸 度量值：路径的"代价"，数值越小优先级越高
🔸 多网卡策略：负载均衡、冗余备份、网络隔离
🔸 路由缓存：提升性能的临时存储，需要适当管理
🔸 故障诊断：分层排查，从物理到应用逐步定位
```

### 9.2 关键命令速查


| 功能分类 | **命令** | **说明** |
|---------|---------|----------|
| 🔍 **查看路由** | `ip route show` | `查看完整路由表` |
| 🚪 **默认网关** | `ip route add default via IP` | `添加默认网关` |
| ➕ **静态路由** | `ip route add 网段 via 网关` | `添加静态路由` |
| ❌ **删除路由** | `ip route del 网段` | `删除指定路由` |
| 🧹 **清空缓存** | `ip route flush cache` | `清空路由缓存` |
| 🔍 **路径追踪** | `traceroute 目标IP` | `跟踪网络路径` |
| 📡 **连通测试** | `ping -c 4 目标IP` | `测试网络连通性` |

### 9.3 最佳实践建议


**配置管理**：
- ✅ **备份路由表**：修改前先备份当前配置
- ✅ **测试验证**：配置完成后进行连通性测试  
- ✅ **文档记录**：记录配置变更的原因和时间
- ✅ **分步实施**：复杂配置分阶段进行，避免一次性大改

**性能优化**：
- ⚡ **合理设置度量值**：内网路径度量值小于外网
- ⚡ **定期清理缓存**：避免过期路由信息影响性能
- ⚡ **监控路由表大小**：过大的路由表影响查找速度
- ⚡ **使用策略路由**：复杂网络环境下的精细化控制

**故障预防**：
- 🛡️ **冗余配置**：关键路径配置备用路由
- 🛡️ **监控告警**：路由状态变化及时通知
- 🛡️ **定期检查**：主动发现潜在的路由问题
- 🛡️ **应急预案**：制定网络故障的快速恢复方案

### 9.4 学习进度检查


**基础技能** `✅ 已掌握` `🔄 学习中` `⏳ 待学习`：
- [ ] 理解路由表的基本结构和作用原理
- [ ] 能够查看和分析当前系统的路由配置
- [ ] 掌握默认网关的配置和修改方法
- [ ] 会添加、删除和修改静态路由
- [ ] 了解路由优先级和度量值的作用

**进阶技能** `⭐⭐⭐☆☆`：
- [ ] 掌握多网卡环境下的路由策略配置
- [ ] 能够进行路由缓存的管理和优化
- [ ] 具备网络故障的诊断和排除能力
- [ ] 了解策略路由和高级路由特性

> 💡 **学习建议**：路由配置是网络管理的核心技能，建议通过实际操作加深理解。可以在虚拟机环境中搭建多网段测试环境，练习各种路由配置场景。

**核心记忆**：
- 路由表是网络的导航图，指引数据包的前进方向
- 默认网关是通往外网的大门，没有它就是"井底之蛙"
- 静态路由提供精确控制，度量值决定路径优先级
- 故障诊断要分层进行，从物理到逻辑逐步排查