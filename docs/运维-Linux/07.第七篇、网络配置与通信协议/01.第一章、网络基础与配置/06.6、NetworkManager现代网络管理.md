---
title: 6、NetworkManager现代网络管理
---
## 📚 目录

1. [NetworkManager基础概念](#1-networkmanager基础概念)
2. [架构组件深入理解](#2-架构组件深入理解)
3. [nmcli命令行工具详解](#3-nmcli命令行工具详解)
4. [nmtui图形化配置](#4-nmtui图形化配置)
5. [连接配置与管理](#5-连接配置与管理)
6. [高级网络管理功能](#6-高级网络管理功能)
7. [与传统网络配置对比](#7-与传统网络配置对比)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌐 NetworkManager基础概念


### 1.1 什么是NetworkManager


**简单理解**: NetworkManager就像是Linux系统的"网络管家"，它帮你自动管理所有的网络连接，不需要你手动去修改复杂的配置文件。

**🔸 核心作用**
- **自动化管理**: 自动检测网络设备，自动连接已知网络
- **统一接口**: 有线、无线、VPN等所有网络都用同一套工具管理  
- **用户友好**: 提供图形界面和命令行工具，比传统方式简单很多
- **动态适应**: 网络环境变化时自动切换连接

### 1.2 为什么需要NetworkManager


**🔹 传统网络配置的问题**
```
传统方式的麻烦：
✗ 需要手动编辑多个配置文件
✗ 网络变化时需要手动重启服务
✗ 有线无线需要分别配置
✗ 移动办公时需要频繁手动切换
```

**🔹 NetworkManager的优势**
```
现代方式的便利：
✓ 一个工具管理所有网络
✓ 自动检测和连接
✓ 图形化配置界面
✓ 支持复杂网络场景
```

### 1.3 适用场景


| 使用场景 | **是否适合** | **原因说明** |
|---------|-------------|-------------|
| 🖥️ **桌面系统** | ✅ `强烈推荐` | `图形界面便于日常使用` |
| 💻 **笔记本电脑** | ✅ `必备工具` | `频繁切换网络环境` |
| 🏢 **办公环境** | ✅ `很适合` | `支持企业级网络配置` |
| 🖥️ **服务器** | ⚠️ `需考虑` | `简单环境可用传统方式` |
| 🔧 **嵌入式系统** | ❌ `不推荐` | `资源占用相对较高` |

---

## 2. 🏗️ 架构组件深入理解


### 2.1 NetworkManager整体架构


```
NetworkManager 系统架构图：

┌─────────────────────────────────────────────────────────┐
│                    用户交互层                            │
├─────────────┬─────────────┬─────────────┬──────────────┤
│   桌面环境   │    nmtui    │    nmcli    │   配置文件    │
│  (GUI工具)  │ (文本界面)   │  (命令行)    │   (手动编辑)  │
└─────────────┴─────────────┴─────────────┴──────────────┘
              │             │             │
              └─────────────┼─────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                NetworkManager 守护进程                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  连接管理器  │  │  设备管理器  │  │  配置管理器  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
              │             │             │
┌─────────────┴─────────────┴─────────────┴──────────────┐
│                    系统内核层                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  网络接口    │  │  路由表      │  │  DNS设置    │    │
│  │  (eth0,wlan0)│  │  (ip route) │  │(/etc/resolv) │   │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
```

### 2.2 核心组件详解


**🔸 NetworkManager守护进程 (networkmanager.service)**
- **作用**: 系统的"网络大脑"，负责所有网络决策
- **职责**: 监控网络设备、管理连接状态、处理网络事件
- **运行方式**: 后台服务，开机自启动

**🔸 连接配置文件 (Connection Profiles)**  
- **位置**: `/etc/NetworkManager/system-connections/`
- **格式**: INI格式的配置文件
- **内容**: 存储网络连接的所有参数（IP、DNS、密码等）

**🔸 设备管理 (Device Management)**
- **功能**: 自动检测和管理网络硬件设备
- **类型**: 有线网卡、无线网卡、蓝牙、VPN等
- **状态跟踪**: 设备的启用/禁用、连接/断开状态

### 2.3 工作流程机制


**🔹 网络连接建立过程**
```
用户请求连接
        ↓
NetworkManager 查找匹配的 Connection Profile
        ↓
验证网络参数和认证信息
        ↓
调用系统内核建立网络连接
        ↓
配置 IP 地址、路由、DNS
        ↓
监控连接状态，处理异常
```

**🔹 自动连接逻辑**
```
系统启动/网络设备插入
        ↓
扫描可用网络
        ↓
根据优先级和自动连接设置
        ↓
选择最佳网络自动连接
        ↓
连接失败时尝试备用网络
```

---

## 3. 💻 nmcli命令行工具详解


### 3.1 nmcli基本语法结构


**🔸 命令格式理解**
```bash
nmcli [选项] 对象 操作 [参数]
```

**各部分含义**:
- **选项**: 控制输出格式和行为（如 `-t` 简洁输出）
- **对象**: 要操作的网络组件（device、connection、general等）
- **操作**: 具体要执行的动作（show、add、modify等）
- **参数**: 操作所需的具体参数

### 3.2 常用对象和操作


| 对象类型 | **主要用途** | **常用操作** | **使用场景** |
|---------|-------------|-------------|-------------|
| 🔌 **device** | `管理网络设备` | `show, status, connect` | `查看网卡状态，启用禁用设备` |
| 🔗 **connection** | `管理连接配置` | `show, add, modify, delete` | `创建和修改网络连接` |
| ⚙️ **general** | `系统整体状态` | `status, hostname` | `查看系统网络状态` |
| 📶 **radio** | `无线设备控制` | `wifi, wwan` | `开关WiFi和移动网络` |

### 3.3 实用命令示例


**🔸 查看系统网络状态**
```bash
# 查看整体网络状态
nmcli general status

# 查看所有网络设备
nmcli device status

# 查看所有连接配置
nmcli connection show
```

**🔸 WiFi网络管理**
```bash
# 扫描可用WiFi
nmcli device wifi list

# 连接到WiFi（系统会提示输入密码）
nmcli device wifi connect "WiFi名称"

# 连接WiFi并直接提供密码
nmcli device wifi connect "WiFi名称" password "密码"

# 查看已保存的WiFi连接
nmcli connection show --active
```

**🔸 有线网络配置**
```bash
# 创建静态IP连接
nmcli connection add type ethernet con-name "办公网络" \
    ifname eth0 ip4 192.168.1.100/24 gw4 192.168.1.1

# 修改现有连接的IP地址
nmcli connection modify "办公网络" ipv4.addresses 192.168.1.150/24

# 启用连接
nmcli connection up "办公网络"
```

### 3.4 nmcli输出格式优化


**🔸 表格格式输出**
```bash
# 默认详细输出
nmcli device show eth0

# 简洁表格输出
nmcli -t device show eth0

# 仅显示特定字段
nmcli -t -f DEVICE,STATE device status
```

**🔹 输出结果理解**
- **STATE**: 设备状态（connected已连接、disconnected未连接）
- **CONNECTION**: 当前使用的连接配置名称
- **TYPE**: 设备类型（ethernet有线、wifi无线）

---

## 4. 🖥️ nmtui图形化配置


### 4.1 nmtui界面介绍


**什么是nmtui**: 这是NetworkManager提供的**文本用户界面**，虽然在终端中运行，但提供了类似图形界面的菜单操作方式。

**🔸 启动nmtui**
```bash
# 直接启动主菜单
nmtui

# 直接进入编辑连接界面
nmtui edit

# 直接进入激活连接界面  
nmtui connect
```

### 4.2 主要功能界面


**🔹 nmtui主菜单结构**
```
┌─────────────────────────────┐
│     NetworkManager TUI      │
├─────────────────────────────┤
│  Edit a connection          │  ← 编辑网络连接
│  Activate a connection      │  ← 激活网络连接  
│  Set system hostname        │  ← 设置主机名
│                             │
│             Quit            │  ← 退出程序
└─────────────────────────────┘
```

### 4.3 常用操作流程


**🔸 创建新的有线连接**
1. 启动 `nmtui` → 选择 "Edit a connection"
2. 选择 "Add" → 选择连接类型 "Ethernet"
3. 配置连接参数：
   - **Profile name**: 连接的名称（如"办公网络"）
   - **Device**: 选择网络接口（如eth0）
   - **IPv4**: 选择自动(DHCP)或手动配置静态IP

**🔸 修改WiFi连接**
1. nmtui → "Edit a connection" → 选择要修改的WiFi连接
2. 可以修改：网络密码、IP配置、DNS设置等
3. 保存后自动应用更改

### 4.4 nmtui的优势


**🔹 相比命令行的优势**
- **可视化**: 能看到所有可配置的选项
- **容错性**: 有输入验证，不容易配置错误
- **直观性**: 配置关系一目了然

**🔹 相比图形界面的优势**  
- **轻量级**: 不需要图形桌面环境
- **远程友好**: SSH连接中也能使用
- **快速**: 比图形界面启动更快

---

## 5. 🔗 连接配置与管理


### 5.1 Connection Profile概念深入


**什么是Connection Profile**: 可以理解为"网络连接的配方"，它记录了连接某个网络所需的所有信息。

**🔸 Profile包含的信息**
```
一个WiFi连接的Profile包含：
├── 基本信息: 连接名称、设备类型
├── 网络信息: SSID、加密方式、密码  
├── IP配置: 自动获取或静态IP设置
├── DNS配置: DNS服务器地址
├── 连接行为: 自动连接、优先级
└── 高级选项: MAC地址、MTU等
```

### 5.2 连接管理实操


**🔸 查看连接详情**
```bash
# 列出所有连接（包括未激活的）
nmcli connection show

# 查看特定连接的详细配置
nmcli connection show "连接名称"

# 仅查看激活的连接
nmcli connection show --active
```

**🔸 连接的生命周期管理**
```bash
# 激活连接
nmcli connection up "连接名称"

# 断开连接
nmcli connection down "连接名称"  

# 重新加载连接配置
nmcli connection reload

# 删除连接配置
nmcli connection delete "连接名称"
```

### 5.3 自动连接机制


**🔹 自动连接的工作原理**
```
NetworkManager 的自动连接逻辑：

网络可用时
    ↓
检查是否有匹配的 Profile
    ↓  
Profile 设置了自动连接？
    ↓ (是)
检查连接优先级
    ↓
选择优先级最高的连接
    ↓
尝试建立连接
```

**🔸 配置自动连接**
```bash
# 设置连接为自动连接
nmcli connection modify "连接名称" connection.autoconnect yes

# 关闭自动连接
nmcli connection modify "连接名称" connection.autoconnect no

# 设置连接优先级（数字越大优先级越高）
nmcli connection modify "连接名称" connection.autoconnect-priority 10
```

### 5.4 连接优先级管理


**🔹 优先级的实际意义**

假设你有以下网络连接：
- 办公室WiFi（优先级：100）
- 手机热点（优先级：50）  
- 有线网络（优先级：200）

**工作场景**: 在办公室时，有线网络优先级最高会自动连接；拔掉网线后自动切换到办公室WiFi；都没有时才连接手机热点。

```bash
# 查看连接优先级
nmcli -f NAME,AUTOCONNECT,AUTOCONNECT-PRIORITY connection show

# 调整优先级示例
nmcli connection modify "办公室有线" connection.autoconnect-priority 200
nmcli connection modify "办公室WiFi" connection.autoconnect-priority 100  
nmcli connection modify "手机热点" connection.autoconnect-priority 50
```

---

## 6. 🚀 高级网络管理功能


### 6.1 有线无线统一管理


**🔹 统一管理的核心价值**

传统方式需要分别配置：
- 有线网络：修改 `/etc/sysconfig/network-scripts/ifcfg-eth0`
- 无线网络：配置 `wpa_supplicant`
- DNS设置：修改 `/etc/resolv.conf`

**NetworkManager的统一方式**：
- 所有网络类型使用相同的命令和工具
- 统一的配置文件格式和存储位置
- 一致的管理界面和操作逻辑

**🔸 实际应用示例**
```bash
# 使用相同命令管理不同类型网络

# 查看所有类型设备状态
nmcli device status

# 有线网络连接
nmcli connection up "有线连接1"

# 无线网络连接  
nmcli connection up "WiFi连接"

# VPN连接
nmcli connection up "公司VPN"
```

### 6.2 VPN连接配置管理


**🔹 VPN配置的简化**

**什么是VPN**: 虚拟专用网络，让你能安全地连接到远程网络，就像在本地一样使用远程资源。

**🔸 支持的VPN类型**
- **OpenVPN**: 最常用的开源VPN解决方案
- **PPTP**: 较老的VPN协议，配置简单但安全性较低  
- **L2TP/IPSec**: 企业常用的VPN类型
- **Cisco AnyConnect**: 企业级SSL VPN

**🔸 创建VPN连接示例**
```bash
# 创建OpenVPN连接
nmcli connection add type vpn con-name "公司VPN" \
    vpn-type openvpn \
    vpn.data "remote=vpn.company.com,port=1194,comp-lzo=yes"

# 导入OpenVPN配置文件
nmcli connection import type openvpn file /path/to/client.ovpn
```

### 6.3 网络故障诊断


**🔹 常用诊断命令**
```bash
# 查看NetworkManager服务状态
systemctl status NetworkManager

# 查看网络连接日志
journalctl -u NetworkManager -f

# 重启NetworkManager服务
systemctl restart NetworkManager

# 查看DNS解析状态
nmcli device show eth0 | grep DNS
```

**🔹 常见问题排查思路**
```
网络连接问题排查流程：

1. 检查物理连接
   ↓
2. 检查设备状态 (nmcli device status)
   ↓  
3. 检查连接配置 (nmcli connection show)
   ↓
4. 查看系统日志 (journalctl -u NetworkManager)
   ↓
5. 测试网络连通性 (ping, dig)
```

---

## 7. ⚖️ 与传统网络配置对比


### 7.1 配置方式对比


| 配置内容 | **传统方式** | **NetworkManager** | **优势对比** |
|---------|-------------|-------------------|-------------|
| 🔌 **有线网络** | `编辑ifcfg-eth0文件` | `nmcli或nmtui配置` | `NetworkManager更直观` |
| 📶 **无线网络** | `手动配置wpa_supplicant` | `自动扫描连接` | `NetworkManager简化很多` |
| 🌐 **DNS设置** | `修改/etc/resolv.conf` | `自动管理DNS` | `NetworkManager避免冲突` |
| 🔄 **网络切换** | `手动停止启动服务` | `自动检测切换` | `NetworkManager智能化` |

### 7.2 管理复杂度对比


**🔹 传统网络配置的复杂性**
```
配置一个WiFi连接的传统步骤：

1. 编辑 wpa_supplicant.conf 配置文件
2. 设置网络SSID和密码
3. 配置网络接口文件 ifcfg-wlan0  
4. 设置IP地址、网关、DNS
5. 重启多个网络服务
6. 手动测试连接状态
```

**🔹 NetworkManager的简化方式**
```bash
# 一条命令完成所有配置
nmcli device wifi connect "WiFi名称" password "密码"
```

### 7.3 适用场景分析


**🔸 何时使用NetworkManager**
```
✅ 桌面和笔记本系统 - 需要频繁切换网络
✅ 移动办公环境 - 网络环境经常变化
✅ 复杂网络需求 - 需要VPN、多网络等
✅ 新手用户 - 降低网络配置门槛
```

**🔸 何时考虑传统方式**
```
⚠️ 简单服务器 - 网络配置固定且简单
⚠️ 资源受限环境 - 需要减少系统开销
⚠️ 特殊定制需求 - 需要精细控制网络行为
⚠️ 旧系统兼容 - 与现有脚本和工具集成
```

### 7.4 迁移建议


**🔹 从传统方式迁移到NetworkManager**

**迁移前评估**:
- 确认当前网络配置的复杂度
- 评估是否有自定义脚本依赖传统配置
- 检查是否有特殊网络需求

**迁移步骤**:
1. **备份现有配置**: 保存 `/etc/sysconfig/network-scripts/` 下的配置文件
2. **启用NetworkManager**: `systemctl enable --now NetworkManager`
3. **禁用传统服务**: `systemctl disable network`
4. **重新配置网络**: 使用nmcli或nmtui重建网络连接
5. **测试验证**: 确保所有网络功能正常

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


**🔸 NetworkManager本质理解**
```
NetworkManager = 现代化的网络管理系统
• 自动化：自动检测、连接、切换网络
• 统一化：所有网络类型使用同一套工具  
• 智能化：根据环境自动选择最佳网络
• 简单化：降低网络配置的技术门槛
```

**🔸 核心组件关系**
```
nmcli (命令行) ←→ NetworkManager守护进程 ←→ 系统内核
nmtui (文本界面) ↗                    ↘ Connection Profiles
图形界面工具 ↗                        ↘ 网络设备管理
```

**🔸 Connection Profile概念**
- **Profile = 网络连接的完整配置方案**
- 包含：网络参数、认证信息、连接行为设置
- 一个设备可以有多个Profile，但同时只能激活一个

### 8.2 关键理解要点


**🔹 自动连接机制的智能性**
```
NetworkManager的智能决策：
• 优先级排序：高优先级网络优先连接
• 网络质量评估：信号强度、连接稳定性
• 用户行为学习：记住用户的网络偏好  
• 故障自动切换：主网络故障时切换备用网络
```

**🔹 工具选择的实用原则**
```
根据使用场景选择工具：
• 日常使用：桌面环境的图形工具最方便
• 远程管理：nmcli命令行最适合
• 偶尔配置：nmtui文本界面最直观
• 批量部署：配置文件模板最高效
```

### 8.3 实际应用价值


**🎯 解决的实际问题**
- **移动办公**: 在家、公司、客户现场网络自动切换
- **网络故障**: 主网络断开时自动切换到备用网络
- **复杂配置**: VPN、企业网络等复杂场景的简化配置
- **团队管理**: 统一的网络配置标准，降低维护成本

**🔧 实用操作技巧**
- **快速连接**: `nmcli device wifi connect "网络名" password "密码"`
- **状态查看**: `nmcli general status` 了解整体网络状态
- **连接管理**: `nmcli connection show --active` 查看当前连接
- **故障排查**: `journalctl -u NetworkManager -f` 实时查看日志

### 8.4 学习进阶路线


**🔰 初级掌握** (⏱️ 预计2-3天)
- [ ] 理解NetworkManager基本概念和作用
- [ ] 掌握nmcli基本命令查看网络状态
- [ ] 学会使用nmtui进行基本网络配置
- [ ] 能够连接WiFi和配置有线网络

**🔸 中级应用** (⏱️ 预计1-2周)
- [ ] 熟练使用nmcli进行各种网络配置
- [ ] 理解Connection Profile的概念和管理
- [ ] 掌握自动连接和优先级设置
- [ ] 能够配置VPN和复杂网络环境

**⭐ 高级运用** (⏱️ 预计2-4周)
- [ ] 能够进行网络故障诊断和排查
- [ ] 掌握NetworkManager与传统方式的迁移
- [ ] 理解企业级网络管理最佳实践
- [ ] 能够编写网络自动化配置脚本

**核心记忆口诀**：
- NetworkManager网络管家，自动智能人人夸
- nmcli命令行操作，nmtui界面更直观
- Profile配置很重要，优先级设置要记牢
- 有线无线同管理，VPN配置也简易