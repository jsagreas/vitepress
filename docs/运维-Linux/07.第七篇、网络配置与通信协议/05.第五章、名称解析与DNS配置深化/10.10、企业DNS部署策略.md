---
title: 10ã€ä¼ä¸šDNSéƒ¨ç½²ç­–ç•¥
---
## ðŸ“š ç›®å½•

1. [ä¼ä¸šDNSæ¦‚è¿°ä¸Žæž¶æž„è®¾è®¡](#1-ä¼ä¸šDNSæ¦‚è¿°ä¸Žæž¶æž„è®¾è®¡)
2. [å†…ç½‘DNSæœåŠ¡å™¨éƒ¨ç½²å®žè·µ](#2-å†…ç½‘DNSæœåŠ¡å™¨éƒ¨ç½²å®žè·µ)
3. [è½¬å‘å™¨ä¸Žæ¡ä»¶è½¬å‘é…ç½®](#3-è½¬å‘å™¨ä¸Žæ¡ä»¶è½¬å‘é…ç½®)
4. [DNSè´Ÿè½½å‡è¡¡ä¸Žé«˜å¯ç”¨é…ç½®](#4-DNSè´Ÿè½½å‡è¡¡ä¸Žé«˜å¯ç”¨é…ç½®)
5. [ä¸»ä»ŽDNSæœåŠ¡å™¨æž¶æž„](#5-ä¸»ä»ŽDNSæœåŠ¡å™¨æž¶æž„)
6. [ä¼ä¸šåŸŸåç­–ç•¥ä¸ŽåŒºåŸŸç®¡ç†](#6-ä¼ä¸šåŸŸåç­–ç•¥ä¸ŽåŒºåŸŸç®¡ç†)
7. [åˆ†æ”¯æœºæž„DNSæž¶æž„è®¾è®¡](#7-åˆ†æ”¯æœºæž„DNSæž¶æž„è®¾è®¡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ¢ ä¼ä¸šDNSæ¦‚è¿°ä¸Žæž¶æž„è®¾è®¡


### 1.1 ä»€ä¹ˆæ˜¯ä¼ä¸šDNSéƒ¨ç½²


**ç®€å•ç†è§£**ï¼šä¼ä¸šDNSå°±åƒå…¬å¸å†…éƒ¨çš„"ç”µè¯ç°¿ç®¡ç†ç³»ç»Ÿ"ï¼Œå®ƒå¸®åŠ©å…¬å¸å†…æ‰€æœ‰è®¾å¤‡å¿«é€Ÿæ‰¾åˆ°å½¼æ­¤ã€‚

```
æƒ³è±¡åœºæ™¯ï¼š
å‘˜å·¥å°æ˜Žæƒ³è®¿é—®å…¬å¸æ–‡ä»¶æœåŠ¡å™¨
å°æ˜Žè¾“å…¥ï¼šfileserver.company.com
DNSç³»ç»Ÿç«‹å³å‘Šè¯‰ä»–ï¼šè¿™å°æœåŠ¡å™¨åœ¨192.168.1.100

æ²¡æœ‰DNSçš„è¯ï¼š
å°æ˜Žéœ€è¦è®°ä½æ‰€æœ‰æœåŠ¡å™¨çš„IPåœ°å€
192.168.1.100 - æ–‡ä»¶æœåŠ¡å™¨
192.168.1.200 - é‚®ä»¶æœåŠ¡å™¨  
192.168.1.300 - æ‰“å°æœåŠ¡å™¨
...è®°ä¸ä½ï¼
```

### 1.2 ä¼ä¸šDNSæž¶æž„è®¾è®¡åŽŸåˆ™


**ðŸŽ¯ æ ¸å¿ƒè®¾è®¡æ€è·¯**

```
ä¼ä¸šDNSæž¶æž„å›¾ï¼š

äº’è”ç½‘
    â†‘
â”Œâ”€â”€â”€â”´â”€â”€â”€â”
â”‚å…¬ç½‘DNS â”‚  â† 8.8.8.8, 114.114.114.114
â”‚æœåŠ¡å™¨  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
â”‚é˜²ç«å¢™   â”‚
â”‚DMZåŒºåŸŸ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å†…ç½‘ä¸»DNSæœåŠ¡å™¨   â”‚  â† 192.168.1.10 (ä¸»è¦)
â”‚company.local    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å†…ç½‘ä»ŽDNSæœåŠ¡å™¨   â”‚  â† 192.168.1.11 (å¤‡ä»½)
â”‚company.local    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
å„éƒ¨é—¨å®¢æˆ·ç«¯è®¾å¤‡
```

**å…³é”®è®¾è®¡åŽŸåˆ™**ï¼š

| åŽŸåˆ™ | **è¯´æ˜Ž** | **å®žé™…æ„ä¹‰** |
|------|---------|-------------|
| **ðŸ”„ å†—ä½™å¤‡ä»½** | `è‡³å°‘2å°DNSæœåŠ¡å™¨` | `ä¸€å°åäº†å¦ä¸€å°ç»§ç»­å·¥ä½œ` |
| **âš¡ å°±è¿‘æœåŠ¡** | `æ¯ä¸ªåœ°ç‚¹éƒ½æœ‰DNSæœåŠ¡å™¨` | `æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œä¸ä¾èµ–ç½‘ç»œ` |
| **ðŸ”’ å®‰å…¨éš”ç¦»** | `å†…å¤–ç½‘DNSåˆ†ç¦»` | `å†…éƒ¨æœåŠ¡å™¨ä¸è¢«å¤–ç½‘å‘çŽ°` |
| **ðŸ“ˆ è´Ÿè½½åˆ†æ‹…** | `å¤šå°æœåŠ¡å™¨åˆ†æ‹…æŸ¥è¯¢åŽ‹åŠ›` | `é¿å…å•ç‚¹è¿‡è½½` |

### 1.3 ä¼ä¸šDNSä¸Žå®¶ç”¨DNSçš„åŒºåˆ«


**å®¶ç”¨DNSï¼ˆç®€å•ï¼‰**ï¼š
- å°±åƒå®¶é‡Œåªæœ‰ä¸€ä¸ªç”µè¯ç°¿
- è·¯ç”±å™¨è‡ªå¸¦DNSåŠŸèƒ½å°±å¤Ÿäº†
- è®¾å¤‡å°‘ï¼Œéœ€æ±‚ç®€å•

**ä¼ä¸šDNSï¼ˆå¤æ‚ï¼‰**ï¼š
- åƒæ•´ä¸ªåŸŽå¸‚çš„ç”µè¯ç³»ç»Ÿ
- éœ€è¦ä¸“ä¸šçš„DNSæœåŠ¡å™¨
- æ•°ç™¾ä¸Šåƒå°è®¾å¤‡
- éœ€è¦å®‰å…¨ã€å¤‡ä»½ã€ç®¡ç†

---

## 2. ðŸ–¥ï¸ å†…ç½‘DNSæœåŠ¡å™¨éƒ¨ç½²å®žè·µ


### 2.1 DNSæœåŠ¡å™¨è½¯ä»¶é€‰æ‹©


**ä¸»æµDNSæœåŠ¡å™¨è½¯ä»¶å¯¹æ¯”**ï¼š

| è½¯ä»¶ | **é€‚ç”¨åœºæ™¯** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** |
|------|-------------|---------|---------|
| **BIND9** | `å¤§åž‹ä¼ä¸šã€å¤æ‚çŽ¯å¢ƒ` | `åŠŸèƒ½æœ€å…¨ã€æ€§èƒ½å¼ºã€æ”¯æŒæ‰€æœ‰æ ‡å‡†` | `é…ç½®å¤æ‚ã€å­¦ä¹ æˆæœ¬é«˜` |
| **Dnsmasq** | `ä¸­å°ä¼ä¸šã€ç®€å•çŽ¯å¢ƒ` | `é…ç½®ç®€å•ã€èµ„æºå ç”¨å°‘` | `åŠŸèƒ½ç›¸å¯¹ç®€å•` |
| **PowerDNS** | `éœ€è¦æ•°æ®åº“æ”¯æŒçš„çŽ¯å¢ƒ` | `æ”¯æŒå¤šç§æ•°æ®åº“ã€Webç®¡ç†ç•Œé¢` | `éœ€è¦é¢å¤–çš„æ•°æ®åº“æœåŠ¡` |
| **Windows DNS** | `WindowsåŸŸçŽ¯å¢ƒ` | `ä¸ŽADé›†æˆå¥½ã€å›¾å½¢åŒ–ç®¡ç†` | `åªèƒ½åœ¨Windowsä¸Šè¿è¡Œ` |

### 2.2 BIND9éƒ¨ç½²å®žæˆ˜ï¼ˆæŽ¨èæ–¹æ¡ˆï¼‰


**âš ï¸ ä¸ºä»€ä¹ˆé€‰æ‹©BIND9ï¼Ÿ**
- åŠŸèƒ½æœ€å®Œæ•´ï¼Œæ”¯æŒæ‰€æœ‰DNSç‰¹æ€§
- ç¨³å®šæ€§æžé«˜ï¼Œå…¨çƒå¤§é‡ä½¿ç”¨
- å¼€æºå…è´¹ï¼Œé…ç½®çµæ´»

**ðŸ”§ å®‰è£…é…ç½®æ­¥éª¤**

**Step â‘  å®‰è£…BIND9**
```bash
# Ubuntu/Debianç³»ç»Ÿ
sudo apt update
sudo apt install bind9 bind9utils bind9-doc

# CentOS/RHELç³»ç»Ÿ  
sudo yum install bind bind-utils
```

**Step â‘¡ åŸºç¡€é…ç½®æ–‡ä»¶**
```bash
# ä¸»é…ç½®æ–‡ä»¶ä½ç½®
/etc/bind/named.conf      # ä¸»é…ç½®æ–‡ä»¶
/etc/bind/named.conf.local # æœ¬åœ°åŒºåŸŸé…ç½®
/var/lib/bind/           # åŒºåŸŸæ–‡ä»¶å­˜æ”¾ç›®å½•
```

**Step â‘¢ é…ç½®ä¸»DNSæœåŠ¡å™¨**

ç¼–è¾‘ `/etc/bind/named.conf.options`ï¼š
```
options {
    directory "/var/cache/bind";
    
    // è®¾ç½®ç›‘å¬åœ°å€
    listen-on { 192.168.1.10; 127.0.0.1; };
    
    // å…è®¸æŸ¥è¯¢çš„å®¢æˆ·ç«¯
    allow-query { 
        127.0.0.1; 
        192.168.0.0/16; 
        10.0.0.0/8; 
    };
    
    // è®¾ç½®è½¬å‘å™¨ï¼ˆå…¬ç½‘DNSï¼‰
    forwarders {
        8.8.8.8;
        114.114.114.114;
    };
    
    // å®‰å…¨è®¾ç½®
    allow-transfer { 192.168.1.11; }; // åªå…è®¸ä»ŽæœåŠ¡å™¨åŒæ­¥
    recursion yes;
    
    dnssec-validation auto;
};
```

### 2.3 åˆ›å»ºä¼ä¸šå†…ç½‘åŸŸ


**é…ç½®ä¼ä¸šåŸŸï¼šcompany.local**

ç¼–è¾‘ `/etc/bind/named.conf.local`ï¼š
```
// æ­£å‘è§£æžåŒºåŸŸ
zone "company.local" {
    type master;
    file "/var/lib/bind/company.local.zone";
    allow-transfer { 192.168.1.11; };
};

// åå‘è§£æžåŒºåŸŸ  
zone "1.168.192.in-addr.arpa" {
    type master;
    file "/var/lib/bind/192.168.1.rev";
    allow-transfer { 192.168.1.11; };
};
```

**åˆ›å»ºæ­£å‘è§£æžæ–‡ä»¶** `/var/lib/bind/company.local.zone`ï¼š
```
$TTL    604800
@       IN      SOA     dns1.company.local. admin.company.local. (
                        2023091501 ; Serial
                        604800     ; Refresh
                        86400      ; Retry
                        2419200    ; Expire
                        604800 )   ; Negative Cache TTL

; åŸŸåæœåŠ¡å™¨è®°å½•
@               IN      NS      dns1.company.local.
@               IN      NS      dns2.company.local.

; æœåŠ¡å™¨è®°å½•
dns1            IN      A       192.168.1.10
dns2            IN      A       192.168.1.11
fileserver      IN      A       192.168.1.100
mailserver      IN      A       192.168.1.200
webserver       IN      A       192.168.1.150

; åˆ«åè®°å½•
www             IN      CNAME   webserver
ftp             IN      CNAME   fileserver
mail            IN      CNAME   mailserver
```

### 2.4 æœåŠ¡å¯åŠ¨ä¸Žæµ‹è¯•


**ðŸš€ å¯åŠ¨DNSæœåŠ¡**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
sudo named-checkconf
sudo named-checkzone company.local /var/lib/bind/company.local.zone

# å¯åŠ¨æœåŠ¡
sudo systemctl start bind9
sudo systemctl enable bind9

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status bind9
```

**âœ… åŠŸèƒ½æµ‹è¯•**
```bash
# æµ‹è¯•æ­£å‘è§£æž
nslookup fileserver.company.local 192.168.1.10

# æµ‹è¯•åå‘è§£æž  
nslookup 192.168.1.100 192.168.1.10

# æµ‹è¯•é€’å½’æŸ¥è¯¢
nslookup www.baidu.com 192.168.1.10
```

---

## 3. ðŸ”„ è½¬å‘å™¨ä¸Žæ¡ä»¶è½¬å‘é…ç½®


### 3.1 ä»€ä¹ˆæ˜¯DNSè½¬å‘


**é€šä¿—è§£é‡Š**ï¼šDNSè½¬å‘å°±åƒ"é—®è·¯"çš„è¿‡ç¨‹

```
æƒ…æ™¯æ¨¡æ‹Ÿï¼š
å‘˜å·¥é—®å†…ç½‘DNSï¼šç™¾åº¦çš„IPæ˜¯å¤šå°‘ï¼Ÿ
å†…ç½‘DNSæƒ³ï¼šæˆ‘ä¸çŸ¥é“å•Šï¼Œæˆ‘åªç®¡å…¬å¸å†…éƒ¨çš„
å†…ç½‘DNSé—®å…¬ç½‘DNSï¼š8.8.8.8ï¼Œç™¾åº¦IPæ˜¯å¤šå°‘ï¼Ÿ
å…¬ç½‘DNSå›žç­”ï¼š180.97.33.108
å†…ç½‘DNSå‘Šè¯‰å‘˜å·¥ï¼šç™¾åº¦IPæ˜¯180.97.33.108

è¿™ä¸ªè¿‡ç¨‹å°±å«"è½¬å‘"
```

### 3.2 è½¬å‘å™¨é…ç½®ç±»åž‹


**ðŸŽ¯ å…¨å±€è½¬å‘å™¨é…ç½®**

é€‚ç”¨åœºæ™¯ï¼šæ‰€æœ‰æœªçŸ¥åŸŸåéƒ½è½¬å‘åˆ°æŒ‡å®šDNSæœåŠ¡å™¨

```
options {
    // å…¨å±€è½¬å‘å™¨é…ç½®
    forwarders {
        8.8.8.8;        // Google DNS
        8.8.4.4;        // Google DNSå¤‡ç”¨
        114.114.114.114; // 114 DNS
        119.29.29.29;   // è…¾è®¯DNS
    };
    
    // è½¬å‘æ¨¡å¼
    forward first;  // å…ˆè½¬å‘ï¼Œå¤±è´¥åŽè‡ªå·±è§£æž
    // forward only; // åªè½¬å‘ï¼Œä¸è‡ªå·±è§£æž
};
```

**ðŸŽ¯ æ¡ä»¶è½¬å‘é…ç½®**

é€‚ç”¨åœºæ™¯ï¼šç‰¹å®šåŸŸåè½¬å‘åˆ°ç‰¹å®šDNSæœåŠ¡å™¨

```
// åˆ†å…¬å¸åŸŸåè½¬å‘åˆ°åˆ†å…¬å¸DNS
zone "branch.company.local" {
    type forward;
    forwarders { 192.168.2.10; 192.168.2.11; };
    forward only;
};

// åˆä½œä¼™ä¼´åŸŸåè½¬å‘
zone "partner.com" {
    type forward;
    forwarders { 10.20.30.10; };
    forward only;
};
```

### 3.3 æ¡ä»¶è½¬å‘å®žé™…åº”ç”¨åœºæ™¯


**åœºæ™¯ä¸€ï¼šå¤šåˆ†å…¬å¸æž¶æž„**

```
æ€»å…¬å¸DNSæž¶æž„ï¼š

æ€»å…¬å¸ (beijing.company.com)
â”œâ”€â”€ DNS1: 192.168.1.10
â””â”€â”€ DNS2: 192.168.1.11

ä¸Šæµ·åˆ†å…¬å¸ (shanghai.company.com)  
â”œâ”€â”€ DNS1: 192.168.2.10
â””â”€â”€ DNS2: 192.168.2.11

æ·±åœ³åˆ†å…¬å¸ (shenzhen.company.com)
â”œâ”€â”€ DNS1: 192.168.3.10  
â””â”€â”€ DNS2: 192.168.3.11
```

**æ€»å…¬å¸DNSé…ç½®æ¡ä»¶è½¬å‘**ï¼š
```
// ä¸Šæµ·åˆ†å…¬å¸åŸŸåè½¬å‘
zone "shanghai.company.com" {
    type forward;
    forwarders { 
        192.168.2.10;  // ä¸Šæµ·ä¸»DNS
        192.168.2.11;  // ä¸Šæµ·å¤‡DNS
    };
    forward only;
};

// æ·±åœ³åˆ†å…¬å¸åŸŸåè½¬å‘  
zone "shenzhen.company.com" {
    type forward;
    forwarders {
        192.168.3.10;  // æ·±åœ³ä¸»DNS
        192.168.3.11;  // æ·±åœ³å¤‡DNS
    };
    forward only;
};
```

**åœºæ™¯äºŒï¼šäº‘æœåŠ¡é›†æˆ**

```
// AWSäº‘æœåŠ¡åŸŸåè½¬å‘
zone "aws.company.com" {
    type forward;
    forwarders { 
        169.254.169.253;  // AWSå†…éƒ¨DNS
    };
    forward only;
};

// é˜¿é‡Œäº‘æœåŠ¡åŸŸåè½¬å‘
zone "aliyun.company.com" {
    type forward; 
    forwarders {
        100.100.2.136;   // é˜¿é‡Œäº‘å†…éƒ¨DNS
        100.100.2.138;
    };
    forward only;
};
```

### 3.4 è½¬å‘æ€§èƒ½ä¼˜åŒ–


**âš¡ è½¬å‘å™¨é€‰æ‹©ç­–ç•¥**

| è½¬å‘å™¨ç±»åž‹ | **æŽ¨èDNS** | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|-----------|------------|---------|-------------|
| **å›½å¤–å…¬å…±DNS** | `8.8.8.8, 1.1.1.1` | `ç¨³å®šã€åŠŸèƒ½å…¨` | `è®¿é—®å›½å¤–ç½‘ç«™å¤š` |
| **å›½å†…å…¬å…±DNS** | `114.114.114.114, 119.29.29.29` | `é€Ÿåº¦å¿«ã€æœ¬åœ°åŒ–` | `ä¸»è¦è®¿é—®å›½å†…ç½‘ç«™` |
| **è¿è¥å•†DNS** | `è‡ªåŠ¨èŽ·å–` | `æœ€å¿«é€Ÿåº¦` | `ä¸€èˆ¬ä¼ä¸šçŽ¯å¢ƒ` |
| **ä¼ä¸šä¸Šçº§DNS** | `ä¸Šçº§æœºæž„DNS` | `ç»Ÿä¸€ç®¡ç†` | `é›†å›¢ä¼ä¸šçŽ¯å¢ƒ` |

**ç¼“å­˜ä¼˜åŒ–é…ç½®**ï¼š
```
options {
    // å¢žå¤§ç¼“å­˜å¤§å°
    max-cache-size 256M;
    
    // é¢„å–çƒ­é—¨åŸŸå
    prefetch 2 9;
    
    // è®¾ç½®åˆç†çš„TTL
    max-cache-ttl 86400;    // æœ€å¤§ç¼“å­˜24å°æ—¶
    max-ncache-ttl 3600;    // è´Ÿç¼“å­˜1å°æ—¶
};
```

---

## 4. âš–ï¸ DNSè´Ÿè½½å‡è¡¡ä¸Žé«˜å¯ç”¨é…ç½®


### 4.1 DNSè´Ÿè½½å‡è¡¡åŽŸç†


**é€šä¿—ç†è§£**ï¼šDNSè´Ÿè½½å‡è¡¡å°±åƒ"æ™ºèƒ½æ´¾å•ç³»ç»Ÿ"

```
åœºæ™¯è¯´æ˜Žï¼š
å…¬å¸æœ‰3å°WebæœåŠ¡å™¨ï¼š
- web1.company.local â†’ 192.168.1.151  
- web2.company.local â†’ 192.168.1.152
- web3.company.local â†’ 192.168.1.153

ç”¨æˆ·è®¿é—® www.company.local æ—¶ï¼š
ç¬¬1ä¸ªç”¨æˆ· â†’ DNSè¿”å›ž 192.168.1.151
ç¬¬2ä¸ªç”¨æˆ· â†’ DNSè¿”å›ž 192.168.1.152  
ç¬¬3ä¸ªç”¨æˆ· â†’ DNSè¿”å›ž 192.168.1.153
ç¬¬4ä¸ªç”¨æˆ· â†’ DNSè¿”å›ž 192.168.1.151 (å¾ªçŽ¯)

è¿™æ ·æŠŠç”¨æˆ·åˆ†æ•£åˆ°ä¸åŒæœåŠ¡å™¨ï¼Œé¿å…å•å°è¿‡è½½
```

### 4.2 DNSè½®è¯¢è´Ÿè½½å‡è¡¡é…ç½®


**åŸºç¡€è½®è¯¢é…ç½®**

åœ¨åŒºåŸŸæ–‡ä»¶ä¸­é…ç½®å¤šä¸ªAè®°å½•ï¼š
```
; WebæœåŠ¡å™¨è´Ÿè½½å‡è¡¡
www     IN  A   192.168.1.151
www     IN  A   192.168.1.152  
www     IN  A   192.168.1.153

; é‚®ä»¶æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼ˆå¸¦ä¼˜å…ˆçº§ï¼‰
@       IN  MX  10  mail1.company.local.
@       IN  MX  20  mail2.company.local.
@       IN  MX  30  mail3.company.local.

; å¯¹åº”çš„Aè®°å½•
mail1   IN  A   192.168.1.201
mail2   IN  A   192.168.1.202
mail3   IN  A   192.168.1.203
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- DNSè½®è¯¢æ˜¯æœ€ç®€å•çš„è´Ÿè½½å‡è¡¡
- æ— æ³•æ£€æµ‹æœåŠ¡å™¨å¥åº·çŠ¶æ€
- å®¢æˆ·ç«¯ä¼šç¼“å­˜DNSç»“æžœ
- é€‚åˆç®€å•çš„è´Ÿè½½åˆ†æ‹…éœ€æ±‚

### 4.3 é«˜å¯ç”¨DNSæœåŠ¡å™¨éƒ¨ç½²


**ðŸ—ï¸ ä¸»ä»Žæž¶æž„è®¾è®¡**

```
é«˜å¯ç”¨DNSæž¶æž„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    åŒæ­¥    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»DNS     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   ä»ŽDNS     â”‚
â”‚192.168.1.10 â”‚   åŒºåŸŸæ–‡ä»¶  â”‚192.168.1.11 â”‚
â”‚  (Master)   â”‚           â”‚  (Slave)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                         â–²
       â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚        å®¢æˆ·ç«¯é…ç½®                      â”‚
â”‚   ä¸»DNS: 192.168.1.10                â”‚
â”‚   å¤‡DNS: 192.168.1.11                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»DNSæœåŠ¡å™¨é…ç½®**

`/etc/bind/named.conf.local`ï¼š
```
zone "company.local" {
    type master;
    file "/var/lib/bind/company.local.zone";
    
    // å…è®¸ä»ŽæœåŠ¡å™¨åŒæ­¥
    allow-transfer { 192.168.1.11; };
    
    // é€šçŸ¥ä»ŽæœåŠ¡å™¨æ›´æ–°
    notify yes;
    also-notify { 192.168.1.11; };
};
```

**ä»ŽDNSæœåŠ¡å™¨é…ç½®**

`/etc/bind/named.conf.local`ï¼š
```
zone "company.local" {
    type slave;
    file "/var/lib/bind/slaves/company.local.zone";
    
    // æŒ‡å®šä¸»æœåŠ¡å™¨
    masters { 192.168.1.10; };
    
    // æ£€æŸ¥æ›´æ–°é—´éš”
    check-names ignore;
};
```

### 4.4 DNSå¥åº·æ£€æŸ¥ä¸Žæ•…éšœåˆ‡æ¢


**æ™ºèƒ½DNSè§£å†³æ–¹æ¡ˆ**

ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å®žçŽ°å¥åº·æ£€æŸ¥ï¼š

**PowerDNS + PowerDNS-Admin**
```bash
# å®‰è£…PowerDNS
sudo apt install pdns-server pdns-backend-mysql

# é…ç½®å¥åº·æ£€æŸ¥è„šæœ¬
#!/bin/bash
# health_check.sh

WEB_SERVERS=("192.168.1.151" "192.168.1.152" "192.168.1.153")
HEALTHY_SERVERS=()

for server in "${WEB_SERVERS[@]}"; do
    if curl -s --max-time 5 http://$server/health > /dev/null; then
        HEALTHY_SERVERS+=($server)
    fi
done

# æ›´æ–°DNSè®°å½•ï¼ŒåªåŒ…å«å¥åº·çš„æœåŠ¡å™¨
# (å…·ä½“å®žçŽ°ä¾æ®DNSç®¡ç†å·¥å…·è€Œå®š)
```

**å®¢æˆ·ç«¯æ•…éšœåˆ‡æ¢é…ç½®**
```bash
# å®¢æˆ·ç«¯DNSé…ç½®
echo "nameserver 192.168.1.10" > /etc/resolv.conf
echo "nameserver 192.168.1.11" >> /etc/resolv.conf  
echo "nameserver 8.8.8.8" >> /etc/resolv.conf

# è¶…æ—¶å’Œé‡è¯•é…ç½®
echo "options timeout:2" >> /etc/resolv.conf
echo "options attempts:3" >> /etc/resolv.conf
```

---

## 5. ðŸ”— ä¸»ä»ŽDNSæœåŠ¡å™¨æž¶æž„


### 5.1 ä¸»ä»Žå¤åˆ¶åŽŸç†


**DNSä¸»ä»Žå¤åˆ¶å°±åƒ"è€å¸ˆä¸Žå­¦ç”Ÿ"çš„å…³ç³»**

```
DNSä¸»ä»Žå¤åˆ¶è¿‡ç¨‹ï¼š

ä¸»æœåŠ¡å™¨ (è€å¸ˆ)                ä»ŽæœåŠ¡å™¨ (å­¦ç”Ÿ)
     â”‚                           â”‚
     â”‚ â‘ ç®¡ç†å‘˜ä¿®æ”¹DNSè®°å½•          â”‚
     â”‚                           â”‚
     â”‚ â‘¡åºåˆ—å·+1 (SOAè®°å½•)        â”‚
     â”‚                           â”‚
     â”‚ â‘¢é€šçŸ¥ä»ŽæœåŠ¡å™¨æœ‰æ›´æ–°         â”‚â—„â”€â”€â”€â”€â”€â”€â”¤
     â”‚   (NOTIFYæ¶ˆæ¯)            â”‚
     â”‚                           â”‚
     â”‚                    â‘£ä»ŽæœåŠ¡å™¨è¯·æ±‚â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åŒæ­¥æ•°æ® â”‚
     â”‚                     (AXFR)   â”‚
     â”‚                           â”‚
     â”‚ â‘¤å‘é€å®Œæ•´åŒºåŸŸæ•°æ®           â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                           â”‚
     â”‚                    â‘¥ä»ŽæœåŠ¡å™¨åº”ç”¨â”‚
     â”‚                      æ–°æ•°æ®    â”‚
```

### 5.2 åŒºåŸŸä¼ é€é…ç½®è¯¦è§£


**AXFRï¼ˆå®Œæ•´åŒºåŸŸä¼ é€ï¼‰vs IXFRï¼ˆå¢žé‡åŒºåŸŸä¼ é€ï¼‰**

| ä¼ é€ç±»åž‹ | **è¯´æ˜Ž** | **ä½•æ—¶ä½¿ç”¨** | **ä¼˜ç¼ºç‚¹** |
|---------|---------|-------------|-----------|
| **AXFR** | `ä¼ é€æ•´ä¸ªåŒºåŸŸæ–‡ä»¶` | `é¦–æ¬¡åŒæ­¥ã€å¤§é‡å˜æ›´åŽ` | `ç®€å•å¯é ï¼Œä½†æ•°æ®é‡å¤§` |
| **IXFR** | `åªä¼ é€å˜æ›´éƒ¨åˆ†` | `æ—¥å¸¸å¢žé‡æ›´æ–°` | `èŠ‚çœå¸¦å®½ï¼Œä½†å¤æ‚ä¸€äº›` |

**ä¸»æœåŠ¡å™¨AXFRé…ç½®**
```
zone "company.local" {
    type master;
    file "/var/lib/bind/company.local.zone";
    
    // å®‰å…¨é…ç½®ï¼šåªå…è®¸æŒ‡å®šä»ŽæœåŠ¡å™¨ä¼ é€
    allow-transfer { 
        192.168.1.11;    // ä»ŽæœåŠ¡å™¨1
        192.168.1.12;    // ä»ŽæœåŠ¡å™¨2  
    };
    
    // è‡ªåŠ¨é€šçŸ¥é…ç½®
    notify yes;
    also-notify { 
        192.168.1.11; 
        192.168.1.12; 
    };
    
    // å¯ç”¨å¢žé‡ä¼ é€
    ixfr-from-differences yes;
};
```

**ä»ŽæœåŠ¡å™¨é…ç½®**
```
zone "company.local" {
    type slave;
    file "/var/lib/bind/slaves/company.local.zone";
    
    // æŒ‡å®šä¸»æœåŠ¡å™¨
    masters { 192.168.1.10; };
    
    // ä¼ é€é…ç½®
    transfer-source 192.168.1.11;  // æŒ‡å®šä¼ é€æºåœ°å€
    max-transfer-time-in 60;       // ä¼ é€è¶…æ—¶æ—¶é—´
};
```

### 5.3 SOAè®°å½•ä¸Žç‰ˆæœ¬æŽ§åˆ¶


**SOAï¼ˆStart of Authorityï¼‰è®°å½•è¯¦è§£**

```
$TTL    604800
@   IN  SOA dns1.company.local. admin.company.local. (
        2023091501  ; Serial (åºåˆ—å·) â† æœ€é‡è¦ï¼
        3600        ; Refresh (åˆ·æ–°é—´éš”)
        1800        ; Retry (é‡è¯•é—´éš”)  
        1209600     ; Expire (è¿‡æœŸæ—¶é—´)
        86400       ; Minimum TTL
)
```

**åºåˆ—å·ç®¡ç†ç­–ç•¥**ï¼š

**ðŸ“… æ—¥æœŸæ ¼å¼ï¼ˆæŽ¨èï¼‰**ï¼š
- `YYYYMMDDNN`
- `2023091501` = 2023å¹´9æœˆ15æ—¥ç¬¬1æ¬¡ä¿®æ”¹
- `2023091502` = 2023å¹´9æœˆ15æ—¥ç¬¬2æ¬¡ä¿®æ”¹

**ðŸ”¢ ç®€å•é€’å¢ž**ï¼š
- `1, 2, 3, 4...`
- ç®€å•ä½†ä¸ç›´è§‚

**âš ï¸ åºåˆ—å·è§„åˆ™**ï¼š
- å¿…é¡»é€’å¢žï¼ˆå¦åˆ™ä»ŽæœåŠ¡å™¨ä¸ä¼šæ›´æ–°ï¼‰
- æœ€å¤§å€¼ï¼š4294967295
- è¶…è¿‡æœ€å¤§å€¼éœ€è¦ç‰¹æ®Šå¤„ç†

### 5.4 å¤šä¸»æœåŠ¡å™¨æž¶æž„


**å¤æ‚ä¼ä¸šçŽ¯å¢ƒï¼šå¤šä¸ªä¸»æœåŠ¡å™¨**

```
å¤šä¸»DNSæž¶æž„ï¼š

æ€»éƒ¨ä¸»DNS â†â†’ åˆ†å…¬å¸ä¸»DNS â†â†’ å­å…¬å¸ä¸»DNS
    â†“             â†“              â†“
 æ€»éƒ¨ä»ŽDNS      åˆ†å…¬å¸ä»ŽDNS     å­å…¬å¸ä»ŽDNS

æ¯ä¸ªä¸»DNSè´Ÿè´£è‡ªå·±çš„åŸŸï¼š
- æ€»éƒ¨ï¼šhq.company.com
- åˆ†å…¬å¸ï¼šbranch.company.com  
- å­å…¬å¸ï¼šsubsidiary.company.com
```

**é…ç½®ç¤ºä¾‹**ï¼š
```
// æ€»éƒ¨DNSé…ç½®å¤šä¸ªåŸŸ
zone "hq.company.com" {
    type master;
    file "/var/lib/bind/hq.company.com.zone";
};

zone "branch.company.com" {
    type forward;
    forwarders { 192.168.2.10; };  // è½¬å‘åˆ°åˆ†å…¬å¸DNS
};

zone "subsidiary.company.com" {
    type forward; 
    forwarders { 192.168.3.10; };  // è½¬å‘åˆ°å­å…¬å¸DNS
};
```

---

## 6. ðŸŒ ä¼ä¸šåŸŸåç­–ç•¥ä¸ŽåŒºåŸŸç®¡ç†


### 6.1 ä¼ä¸šåŸŸåå‘½åç­–ç•¥


**åŸŸåå‘½åå°±åƒç»™å…¬å¸å„éƒ¨é—¨"å–åœ°å€"**

**ðŸ¢ å¸¸è§ä¼ä¸šåŸŸåç»“æž„**

```
ä¼ä¸šåŸŸåå±‚æ¬¡ç»“æž„ï¼š

company.com (å…¬ç½‘åŸŸå)
â”œâ”€â”€ www.company.com        (å®˜ç½‘)
â”œâ”€â”€ mail.company.com       (é‚®ä»¶ç³»ç»Ÿ)
â””â”€â”€ vpn.company.com        (VPNå…¥å£)

company.local (å†…ç½‘åŸŸå)  
â”œâ”€â”€ servers.company.local   (æœåŠ¡å™¨åŒºåŸŸ)
â”‚   â”œâ”€â”€ web1.servers.company.local
â”‚   â”œâ”€â”€ db1.servers.company.local
â”‚   â””â”€â”€ file1.servers.company.local
â”œâ”€â”€ workstations.company.local (å·¥ä½œç«™åŒºåŸŸ)
â”‚   â”œâ”€â”€ pc001.workstations.company.local
â”‚   â””â”€â”€ pc002.workstations.company.local
â””â”€â”€ departments.company.local (éƒ¨é—¨åŒºåŸŸ)
    â”œâ”€â”€ it.departments.company.local
    â”œâ”€â”€ hr.departments.company.local
    â””â”€â”€ finance.departments.company.local
```

### 6.2 åŒºåŸŸå§”æ´¾é…ç½®


**ä»€ä¹ˆæ˜¯åŒºåŸŸå§”æ´¾ï¼Ÿ**

ç®€å•è¯´å°±æ˜¯"åˆ†æƒç®¡ç†"â€”â€”è®©ä¸åŒéƒ¨é—¨ç®¡ç†è‡ªå·±çš„DNSåŒºåŸŸã€‚

```
åŒºåŸŸå§”æ´¾ç¤ºä¾‹ï¼š

æ€»å…¬å¸DNSè´Ÿè´£ï¼šcompany.local
ITéƒ¨é—¨DNSè´Ÿè´£ï¼šit.company.local  
HRéƒ¨é—¨DNSè´Ÿè´£ï¼šhr.company.local
è´¢åŠ¡éƒ¨é—¨DNSè´Ÿè´£ï¼šfinance.company.local

å°±åƒï¼š
æ€»ç»ç†ç®¡æ•´ä¸ªå…¬å¸
éƒ¨é—¨ç»ç†åªç®¡è‡ªå·±éƒ¨é—¨
```

**çˆ¶åŸŸé…ç½®ï¼ˆcompany.localï¼‰**

```
; ä¸»åŒºåŸŸè®°å½•
$TTL 86400
@   IN  SOA dns1.company.local. admin.company.local. (
        2023091501 ; serial
        3600       ; refresh
        1800       ; retry
        604800     ; expire
        86400      ; minimum
)

@   IN  NS  dns1.company.local.
@   IN  NS  dns2.company.local.

dns1    IN  A   192.168.1.10
dns2    IN  A   192.168.1.11

; å§”æ´¾ITéƒ¨é—¨åŸŸ
it      IN  NS  dns-it.company.local.
dns-it  IN  A   192.168.10.10

; å§”æ´¾HRéƒ¨é—¨åŸŸ  
hr      IN  NS  dns-hr.company.local.
dns-hr  IN  A   192.168.20.10

; å§”æ´¾è´¢åŠ¡éƒ¨é—¨åŸŸ
finance IN  NS  dns-finance.company.local.
dns-finance IN A 192.168.30.10
```

**å­åŸŸé…ç½®ï¼ˆit.company.localï¼‰**

```
; ITéƒ¨é—¨ç‹¬ç«‹ç®¡ç†è¿™ä¸ªåŸŸ
$TTL 86400
@   IN  SOA dns-it.company.local. admin-it.company.local. (
        2023091501 ; serial
        3600       ; refresh
        1800       ; retry  
        604800     ; expire
        86400      ; minimum
)

@       IN  NS  dns-it.company.local.
dns-it  IN  A   192.168.10.10

; ITéƒ¨é—¨çš„æœåŠ¡å™¨
server1 IN  A   192.168.10.100
server2 IN  A   192.168.10.101
switch1 IN  A   192.168.10.20
```

### 6.3 ä¼ä¸šDNSå®‰å…¨ç­–ç•¥


**ðŸ”’ DNSå®‰å…¨å¨èƒä¸Žé˜²æŠ¤**

**å¸¸è§å¨èƒ**ï¼š

| å¨èƒç±»åž‹ | **æ”»å‡»æ–¹å¼** | **å±å®³** | **é˜²æŠ¤æŽªæ–½** |
|---------|-------------|---------|-------------|
| **DNSåŠ«æŒ** | `ç¯¡æ”¹DNSå“åº”` | `ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™` | `ä½¿ç”¨åŠ å¯†DNS (DoT/DoH)` |
| **ç¼“å­˜æŠ•æ¯’** | `ä¼ªé€ DNSå“åº”` | `é•¿æœŸé‡å®šå‘åˆ°æ¶æ„ç«™ç‚¹` | `å¯ç”¨DNSSECéªŒè¯` |
| **DDoSæ”»å‡»** | `å¤§é‡æŸ¥è¯¢æ”»å‡»DNSæœåŠ¡å™¨` | `DNSæœåŠ¡ä¸å¯ç”¨` | `é™æµã€å¤šæœåŠ¡å™¨éƒ¨ç½²` |
| **ä¿¡æ¯æ³„éœ²** | `é€šè¿‡DNSæŸ¥è¯¢æ”¶é›†ä¿¡æ¯` | `æš´éœ²å†…ç½‘ç»“æž„` | `è§†å›¾åˆ†ç¦»ã€è®¿é—®æŽ§åˆ¶` |

**å®‰å…¨é…ç½®å®žè·µ**ï¼š

```
options {
    // åŸºç¡€å®‰å…¨é…ç½®
    version "Private DNS Server";  // éšè—ç‰ˆæœ¬ä¿¡æ¯
    hostname "dns-server";         // éšè—ä¸»æœºå
    
    // é™åˆ¶æŸ¥è¯¢æ¥æº
    allow-query { 
        127.0.0.1; 
        192.168.0.0/16;
        10.0.0.0/8;
    };
    
    // é™åˆ¶é€’å½’æŸ¥è¯¢
    allow-recursion { 
        127.0.0.1;
        192.168.0.0/16; 
    };
    
    // é˜²æ­¢ç¼“å­˜æŠ•æ¯’
    dnssec-validation auto;
    dnssec-enable yes;
    
    // æŸ¥è¯¢é™æµ
    rate-limit {
        responses-per-second 5;
        window 5;
    };
};
```

### 6.4 DNSç›‘æŽ§ä¸Žæ—¥å¿—ç®¡ç†


**ðŸ“Š ç›‘æŽ§æŒ‡æ ‡**

é‡è¦ç›‘æŽ§é¡¹ç›®ï¼š
- DNSæŸ¥è¯¢å“åº”æ—¶é—´
- æŸ¥è¯¢æˆåŠŸçŽ‡
- åŒºåŸŸä¼ é€çŠ¶æ€  
- æœåŠ¡å™¨èµ„æºä½¿ç”¨çŽ‡
- å¼‚å¸¸æŸ¥è¯¢æ¨¡å¼

**æ—¥å¿—é…ç½®**ï¼š
```
logging {
    channel default_debug {
        file "/var/log/bind/default.log" versions 3 size 5m;
        severity debug;
        print-time yes;
    };
    
    channel query_log {
        file "/var/log/bind/queries.log" versions 10 size 50m;
        severity info;
        print-time yes;
    };
    
    category default { default_debug; };
    category queries { query_log; };
};
```

---

## 7. ðŸ¢ åˆ†æ”¯æœºæž„DNSæž¶æž„è®¾è®¡


### 7.1 åˆ†æ”¯æœºæž„DNSéœ€æ±‚åˆ†æž


**åˆ†æ”¯æœºæž„DNSé¢ä¸´çš„æŒ‘æˆ˜**ï¼š

```
å…¸åž‹åˆ†æ”¯æœºæž„åœºæ™¯ï¼š

æ€»å…¬å¸ (åŒ—äº¬)                åˆ†å…¬å¸ (ä¸Šæµ·)
â”œâ”€â”€ å‘˜å·¥ï¼š500äºº              â”œâ”€â”€ å‘˜å·¥ï¼š50äºº  
â”œâ”€â”€ æœåŠ¡å™¨ï¼š100å°            â”œâ”€â”€ æœåŠ¡å™¨ï¼š10å°
â”œâ”€â”€ ç½‘ç»œï¼šåƒå…†ä¸“çº¿           â”œâ”€â”€ ç½‘ç»œï¼šç™¾å…†ä¸“çº¿
â””â”€â”€ ITäººå‘˜ï¼š10äºº             â””â”€â”€ ITäººå‘˜ï¼š1äºº

æŒ‘æˆ˜ï¼š
- ç½‘ç»œå¸¦å®½é™åˆ¶
- ITäººå‘˜ä¸è¶³  
- æœåŠ¡å™¨èµ„æºæœ‰é™
- éœ€è¦è®¿é—®æ€»éƒ¨èµ„æº
```

### 7.2 åˆ†æ”¯æœºæž„DNSæž¶æž„é€‰æ‹©


**ðŸŽ¯ æž¶æž„æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | **è¯´æ˜Ž** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|---------|-------------|
| **æœ¬åœ°DNSæœåŠ¡å™¨** | `åˆ†æ”¯æœºæž„éƒ¨ç½²ç‹¬ç«‹DNS` | `é€Ÿåº¦å¿«ã€è‡ªä¸»å¯æŽ§` | `ç»´æŠ¤æˆæœ¬é«˜ã€éœ€è¦ä¸“ä¸šäººå‘˜` | `å¤§åž‹åˆ†æ”¯æœºæž„` |
| **DNSè½¬å‘æ¨¡å¼** | `æœ¬åœ°DNSè½¬å‘åˆ°æ€»éƒ¨` | `é…ç½®ç®€å•ã€ç»´æŠ¤é‡å°‘` | `ä¾èµ–ç½‘ç»œã€æ€»éƒ¨åŽ‹åŠ›å¤§` | `ä¸­åž‹åˆ†æ”¯æœºæž„` |  
| **ç¼“å­˜DNS** | `åªåšç¼“å­˜ã€ä¸å­˜æƒå¨æ•°æ®` | `æé«˜é€Ÿåº¦ã€å‡å°‘é‡å¤æŸ¥è¯¢` | `åŠŸèƒ½æœ‰é™` | `å°åž‹åˆ†æ”¯æœºæž„` |
| **äº‘DNSæœåŠ¡** | `ä½¿ç”¨äº‘æœåŠ¡å•†DNS` | `æ— éœ€ç»´æŠ¤ã€é«˜å¯ç”¨` | `æˆæœ¬è¾ƒé«˜ã€ä¾èµ–å¤–ç½‘` | `ä¸´æ—¶æˆ–å°åž‹æœºæž„` |

### 7.3 æœ¬åœ°DNSæœåŠ¡å™¨æ–¹æ¡ˆ


**é€‚ç”¨åœºæ™¯**ï¼šè¶…è¿‡50äººçš„åˆ†æ”¯æœºæž„

**æž¶æž„è®¾è®¡**ï¼š
```
åˆ†æ”¯æœºæž„æœ¬åœ°DNSæž¶æž„ï¼š

Internet
    â†‘
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
â”‚æ€»éƒ¨DNS  â”‚ â† ä¸»è¦æƒå¨æœåŠ¡å™¨
â”‚æœåŠ¡å™¨   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â†“ (VPN/ä¸“çº¿)
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”
â”‚åˆ†æ”¯DNS  â”‚ â† ç¼“å­˜+éƒ¨åˆ†æƒå¨
â”‚æœåŠ¡å™¨   â”‚   
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â†“
åˆ†æ”¯æœºæž„å®¢æˆ·ç«¯
```

**é…ç½®ç¤ºä¾‹**ï¼š

åˆ†æ”¯DNSæœåŠ¡å™¨ `/etc/bind/named.conf.options`ï¼š
```
options {
    directory "/var/cache/bind";
    
    // ç›‘å¬æœ¬åœ°ç½‘ç»œ
    listen-on { 192.168.2.10; 127.0.0.1; };
    
    // å…è®¸æœ¬åœ°æŸ¥è¯¢
    allow-query { 127.0.0.1; 192.168.2.0/24; };
    
    // è½¬å‘åˆ°æ€»éƒ¨DNS
    forwarders {
        192.168.1.10;  // æ€»éƒ¨ä¸»DNS
        192.168.1.11;  // æ€»éƒ¨å¤‡DNS
        8.8.8.8;       // å…¬ç½‘DNSå¤‡ç”¨
    };
    
    // å¯ç”¨è½¬å‘æ¨¡å¼
    forward first;
    
    // å¢žå¤§ç¼“å­˜
    max-cache-size 128M;
};
```

æœ¬åœ°åŒºåŸŸé…ç½® `/etc/bind/named.conf.local`ï¼š
```
// æœ¬åœ°åˆ†æ”¯åŸŸ
zone "shanghai.company.local" {
    type master;
    file "/var/lib/bind/shanghai.company.local.zone";
};

// æ€»éƒ¨åŸŸè½¬å‘
zone "company.local" {
    type forward;
    forwarders { 192.168.1.10; 192.168.1.11; };
    forward only;
};
```

### 7.4 DNSè½¬å‘æ¨¡å¼æ–¹æ¡ˆ


**é€‚ç”¨åœºæ™¯**ï¼š10-50äººçš„åˆ†æ”¯æœºæž„

**ç®€åŒ–é…ç½®**ï¼š
```
options {
    directory "/var/cache/bind";
    
    // å…¨éƒ¨è½¬å‘åˆ°æ€»éƒ¨
    forwarders {
        192.168.1.10;   // æ€»éƒ¨DNS
        8.8.8.8;        // å¤‡ç”¨å…¬ç½‘DNS
    };
    
    // åªåšè½¬å‘ï¼Œä¸æƒå¨è§£æž
    forward only;
    
    // åŸºæœ¬ç¼“å­˜é…ç½®  
    max-cache-size 64M;
    max-cache-ttl 3600;
};
```

### 7.5 ç½‘ç»œä¸­æ–­åº”æ€¥å¤„ç†


**ðŸš¨ ç½‘ç»œä¸­æ–­åœºæ™¯å¤„ç†**

å½“åˆ†æ”¯æœºæž„ä¸Žæ€»éƒ¨ç½‘ç»œä¸­æ–­æ—¶ï¼š

**åº”æ€¥DNSé…ç½®**ï¼š
```bash
#!/bin/bash
# emergency_dns.sh - ç½‘ç»œä¸­æ–­åº”æ€¥è„šæœ¬

# æ£€æµ‹åˆ°æ€»éƒ¨ç½‘ç»œä¸­æ–­
if ! ping -c 3 192.168.1.10 > /dev/null; then
    echo "æ€»éƒ¨ç½‘ç»œä¸­æ–­ï¼Œå¯ç”¨åº”æ€¥DNSé…ç½®"
    
    # åˆ‡æ¢åˆ°å…¬ç½‘DNS
    cat > /etc/resolv.conf << EOF
nameserver 8.8.8.8
nameserver 114.114.114.114
options timeout:5
options attempts:2
EOF
    
    # å¯ç”¨æœ¬åœ°hostsæ–‡ä»¶
    cat >> /etc/hosts << EOF
# åº”æ€¥æœ¬åœ°è§£æž
192.168.2.100 fileserver.shanghai.company.local
192.168.2.200 mailserver.shanghai.company.local
192.168.2.150 webserver.shanghai.company.local
EOF
    
    echo "åº”æ€¥DNSé…ç½®å®Œæˆ"
fi
```

**æ¢å¤è„šæœ¬**ï¼š
```bash
#!/bin/bash
# restore_dns.sh - ç½‘ç»œæ¢å¤è„šæœ¬

# æ£€æµ‹æ€»éƒ¨ç½‘ç»œæ¢å¤
if ping -c 3 192.168.1.10 > /dev/null; then
    echo "æ€»éƒ¨ç½‘ç»œæ¢å¤ï¼Œè¿˜åŽŸDNSé…ç½®"
    
    # æ¢å¤æ­£å¸¸DNSé…ç½®
    cat > /etc/resolv.conf << EOF
nameserver 192.168.2.10
nameserver 192.168.1.10
nameserver 8.8.8.8
EOF
    
    # æ¸…ç†åº”æ€¥hostsè®°å½•
    sed -i '/# åº”æ€¥æœ¬åœ°è§£æž/,$d' /etc/hosts
    
    echo "DNSé…ç½®å·²æ¢å¤"
fi
```

---

## 8. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ ä¼ä¸šDNSæž¶æž„ï¼šå†…å¤–ç½‘åˆ†ç¦»ã€ä¸»ä»Žå¤‡ä»½ã€å°±è¿‘æœåŠ¡
ðŸ”¸ BIND9éƒ¨ç½²ï¼šé…ç½®æ–‡ä»¶ç»“æž„ã€åŒºåŸŸç®¡ç†ã€æœåŠ¡å¯åŠ¨
ðŸ”¸ è½¬å‘é…ç½®ï¼šå…¨å±€è½¬å‘ã€æ¡ä»¶è½¬å‘ã€æ€§èƒ½ä¼˜åŒ–
ðŸ”¸ è´Ÿè½½å‡è¡¡ï¼šDNSè½®è¯¢ã€ä¸»ä»Žæž¶æž„ã€é«˜å¯ç”¨è®¾è®¡  
ðŸ”¸ åŒºåŸŸç®¡ç†ï¼šå§”æ´¾é…ç½®ã€SOAè®°å½•ã€ç‰ˆæœ¬æŽ§åˆ¶
ðŸ”¸ åˆ†æ”¯æž¶æž„ï¼šæœ¬åœ°DNSã€è½¬å‘æ¨¡å¼ã€åº”æ€¥å¤„ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ ä¼ä¸šDNSä¸Žå®¶ç”¨DNSçš„æœ¬è´¨åŒºåˆ«**
```
è§„æ¨¡å·®å¼‚ï¼š
- å®¶ç”¨ï¼šå‡ å°è®¾å¤‡ï¼Œç®€å•è·¯ç”±å™¨DNSå³å¯
- ä¼ä¸šï¼šæ•°ç™¾ä¸Šåƒè®¾å¤‡ï¼Œéœ€è¦ä¸“ä¸šDNSæœåŠ¡å™¨

ç®¡ç†éœ€æ±‚ï¼š
- å®¶ç”¨ï¼šåŸºæœ¬è”ç½‘å³å¯
- ä¼ä¸šï¼šéœ€è¦å®‰å…¨ã€å¤‡ä»½ã€ç›‘æŽ§ã€ç®¡ç†

å¯é æ€§è¦æ±‚ï¼š
- å®¶ç”¨ï¼šå¶å°”æ–­ç½‘å¯ä»¥æŽ¥å—
- ä¼ä¸šï¼šDNSæ•…éšœå½±å“æ•´ä¸ªä¸šåŠ¡è¿è¥
```

**ðŸ”¹ è½¬å‘ä¸Žæƒå¨è§£æžçš„é€‰æ‹©**
```
æƒå¨è§£æžï¼šä¼ä¸šå®Œå…¨æŽ§åˆ¶åŸŸåè§£æž
- ä¼˜ç‚¹ï¼šå®Œå…¨è‡ªä¸»ã€å“åº”å¿«ã€å¯å®šåˆ¶
- ç¼ºç‚¹ï¼šç»´æŠ¤å¤æ‚ã€éœ€è¦ä¸“ä¸šçŸ¥è¯†

è½¬å‘æ¨¡å¼ï¼šä¾èµ–ä¸Šçº§DNSæœåŠ¡å™¨
- ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ã€ç»´æŠ¤é‡å°‘
- ç¼ºç‚¹ï¼šä¾èµ–ç½‘ç»œã€æŽ§åˆ¶èƒ½åŠ›æœ‰é™

é€‰æ‹©åŽŸåˆ™ï¼š
- å¤§åž‹ä¼ä¸šï¼šæƒå¨è§£æžä¸ºä¸»ï¼Œè½¬å‘ä¸ºè¾…
- ä¸­å°ä¼ä¸šï¼šè½¬å‘æ¨¡å¼ä¸ºä¸»ï¼Œæœ¬åœ°ç¼“å­˜ä¼˜åŒ–
```

**ðŸ”¹ é«˜å¯ç”¨è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³**
```
å†—ä½™åŽŸåˆ™ï¼š
- è‡³å°‘2å°DNSæœåŠ¡å™¨
- ä¸åŒç½‘ç»œä½ç½®éƒ¨ç½²
- è‡ªåŠ¨æ•…éšœåˆ‡æ¢

å°±è¿‘åŽŸåˆ™ï¼š
- åˆ†æ”¯æœºæž„æœ¬åœ°DNS
- å‡å°‘ç½‘ç»œå»¶è¿Ÿ
- æé«˜ç”¨æˆ·ä½“éªŒ

åˆ†æƒåŽŸåˆ™ï¼š
- ä¸åŒéƒ¨é—¨ç®¡ç†è‡ªå·±çš„åŸŸ
- é™ä½Žç®¡ç†å¤æ‚åº¦
- æé«˜è¿ç»´æ•ˆçŽ‡
```

### 8.3 å®žé™…åº”ç”¨æŒ‡å¯¼


**ðŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•**

éƒ¨ç½²å‰å‡†å¤‡ï¼š
- [ ] ç¡®å®šä¼ä¸šåŸŸåå‘½åç­–ç•¥
- [ ] è§„åˆ’DNSæœåŠ¡å™¨æ•°é‡å’Œä½ç½®
- [ ] å‡†å¤‡æœåŠ¡å™¨ç¡¬ä»¶å’ŒIPåœ°å€
- [ ] è®¾è®¡ç½‘ç»œå®‰å…¨ç­–ç•¥

é…ç½®é˜¶æ®µï¼š
- [ ] å®‰è£…é…ç½®ä¸»DNSæœåŠ¡å™¨
- [ ] é…ç½®ä»ŽDNSæœåŠ¡å™¨åŒæ­¥
- [ ] åˆ›å»ºä¼ä¸šå†…ç½‘åŸŸå’Œè®°å½•
- [ ] é…ç½®è½¬å‘å™¨å’Œæ¡ä»¶è½¬å‘
- [ ] è®¾ç½®å®‰å…¨è®¿é—®æŽ§åˆ¶

æµ‹è¯•éªŒè¯ï¼š
- [ ] æ­£å‘è§£æžåŠŸèƒ½æµ‹è¯•
- [ ] åå‘è§£æžåŠŸèƒ½æµ‹è¯•  
- [ ] é€’å½’æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•
- [ ] ä¸»ä»ŽåŒæ­¥åŠŸèƒ½æµ‹è¯•
- [ ] æ•…éšœåˆ‡æ¢åŠŸèƒ½æµ‹è¯•

è¿ç»´ç›‘æŽ§ï¼š
- [ ] é…ç½®æ—¥å¿—è®°å½•å’Œè½®è½¬
- [ ] è®¾ç½®ç›‘æŽ§å‘Šè­¦
- [ ] åˆ¶å®šå¤‡ä»½ç­–ç•¥
- [ ] ç¼–å†™åº”æ€¥å¤„ç†é¢„æ¡ˆ

### 8.4 å¸¸è§é—®é¢˜ä¸Žè§£å†³æ–¹æ¡ˆ


**â“ å¸¸è§é—®é¢˜**

**é—®é¢˜1ï¼šDNSè§£æžæ…¢**
```
å¯èƒ½åŽŸå› ï¼š
- è½¬å‘å™¨é€‰æ‹©ä¸å½“
- ç¼“å­˜é…ç½®è¿‡å°
- ç½‘ç»œé“¾è·¯é—®é¢˜

è§£å†³æ–¹æ¡ˆï¼š
- é€‰æ‹©å°±è¿‘çš„è½¬å‘å™¨
- å¢žå¤§DNSç¼“å­˜å¤§å°
- ä¼˜åŒ–ç½‘ç»œé“¾è·¯
```

**é—®é¢˜2ï¼šåŒºåŸŸä¼ é€å¤±è´¥**
```
å¯èƒ½åŽŸå› ï¼š
- allow-transferé…ç½®é”™è¯¯
- ç½‘ç»œé˜²ç«å¢™é˜»æŒ¡
- åºåˆ—å·æœªæ›´æ–°

è§£å†³æ–¹æ¡ˆï¼š
- æ£€æŸ¥ä¼ é€æƒé™é…ç½®
- å¼€æ”¾DNSä¼ é€ç«¯å£(53/TCP)
- ç¡®ä¿åºåˆ—å·æ­£ç¡®é€’å¢ž
```

**é—®é¢˜3ï¼šå®¢æˆ·ç«¯æ— æ³•è§£æžå†…ç½‘åŸŸå**
```
å¯èƒ½åŽŸå› ï¼š
- å®¢æˆ·ç«¯DNSé…ç½®é”™è¯¯
- DNSæœåŠ¡å™¨æœªå¯åŠ¨
- åŒºåŸŸæ–‡ä»¶é…ç½®é”™è¯¯

è§£å†³æ–¹æ¡ˆï¼š
- æ£€æŸ¥å®¢æˆ·ç«¯DNSæœåŠ¡å™¨åœ°å€
- ç¡®è®¤DNSæœåŠ¡è¿è¡ŒçŠ¶æ€
- éªŒè¯åŒºåŸŸæ–‡ä»¶è¯­æ³•æ­£ç¡®æ€§
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ä¼ä¸šDNSé‡åœ¨æž¶æž„è®¾è®¡å’Œé«˜å¯ç”¨ä¿éšœ
- é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¸è¿½æ±‚è¿‡åº¦å¤æ‚
- å®‰å…¨é…ç½®å’Œç›‘æŽ§è¿ç»´åŒæ ·é‡è¦
- åˆ†æ”¯æœºæž„è¦è€ƒè™‘ç½‘ç»œæ¡ä»¶å’Œç»´æŠ¤èƒ½åŠ›