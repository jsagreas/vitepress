---
title: 8、netstat网络连接传统分析
---
## 📚 目录

1. [netstat基础概念与作用](#1-netstat基础概念与作用)
2. [netstat核心参数详解](#2-netstat核心参数详解)
3. [网络连接状态分析](#3-网络连接状态分析)
4. [端口与服务识别技巧](#4-端口与服务识别技巧)
5. [网络统计信息解读](#5-网络统计信息解读)
6. [路由表与接口分析](#6-路由表与接口分析)
7. [netstat vs ss命令对比](#7-netstat-vs-ss命令对比)
8. [实战应用场景](#8-实战应用场景)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🌐 netstat基础概念与作用


### 1.1 什么是netstat


**🔸 核心定义**
```
netstat = network statistics (网络统计)
作用：显示网络连接、路由表、接口统计等网络相关信息
定位：Linux系统中最经典的网络诊断工具之一
历史：从Unix时代就存在的传统工具
```

**💡 netstat的核心价值**
> 🏥 **医生类比**：netstat就像医生的听诊器
> - 能"听到"系统网络的各种"心跳声"
> - 发现网络连接的健康状态
> - 诊断网络通信问题的根源

### 1.2 netstat能做什么


**🎯 主要功能清单**
- **连接监控**：查看当前所有网络连接状态
- **端口检查**：找出哪些端口正在监听
- **服务识别**：确定端口对应的具体服务
- **流量统计**：显示网络接口的数据传输情况
- **路由分析**：查看系统路由表信息
- **故障诊断**：发现网络连接异常

**📊 应用场景举例**
```
🔍 日常运维场景：
• 服务器端口80没响应？→ netstat查看是否在监听
• 网站访问慢？→ 看看有多少ESTABLISHED连接
• 系统被攻击？→ 检查异常的网络连接
• 程序启动失败？→ 确认端口是否被占用
```

---

## 2. 🔧 netstat核心参数详解


### 2.1 最常用的基本参数


**📋 核心参数速查表**

| 参数 | 作用 | 记忆技巧 | 使用频率 |
|------|------|----------|----------|
| `-t` | 显示TCP连接 | **T**CP | 🔴 必用 |
| `-u` | 显示UDP连接 | **U**DP | 🟡 常用 |
| `-l` | 只显示监听端口 | **L**isten | 🔴 必用 |
| `-n` | 显示数字地址 | **N**umber | 🔴 必用 |
| `-p` | 显示进程信息 | **P**rocess | 🔴 必用 |

**🎯 黄金组合命令**
```bash
# 最实用的组合：查看所有TCP监听端口
netstat -tlnp

# 完整版：查看所有连接状态
netstat -tulnp
```

> ⚠️ **新手易错点**
> 
> 不加`-n`参数时，netstat会尝试解析域名，导致命令执行很慢
> **记住**：几乎所有情况下都要加`-n`参数！

### 2.2 高级参数详解


**🔸 状态过滤参数**
```bash
# 只看建立的连接
netstat -tn | grep ESTABLISHED

# 统计各种连接状态数量
netstat -tn | awk '{print $6}' | sort | uniq -c
```

**🔸 接口统计参数**
```bash
# 显示网络接口统计
netstat -i        # 简要信息
netstat -ie       # 详细信息(类似ifconfig)
```

**🔸 路由表参数**
```bash
# 显示路由表
netstat -r        # 路由信息
netstat -rn       # 数字格式路由表
```

### 2.3 参数组合使用技巧


**💪 实战组合命令**
```bash
# 查看特定端口的连接
netstat -tlnp | grep :80

# 查看某个进程的网络连接
netstat -tlnp | grep nginx

# 统计连接状态
netstat -tn | grep -E "(LISTEN|ESTABLISHED)" | wc -l

# 查找占用特定端口的进程
netstat -tlnp | grep :8080
```

---

## 3. 🔍 网络连接状态分析


### 3.1 TCP连接状态详解


**🔄 TCP连接状态机**
```
连接建立过程：
CLOSED → LISTEN → SYN_SENT → SYN_RECV → ESTABLISHED

连接关闭过程：
ESTABLISHED → FIN_WAIT1 → FIN_WAIT2 → TIME_WAIT → CLOSED
```

**📊 常见状态含义**

| 状态 | 含义 | 正常情况 | 异常提示 |
|------|------|----------|----------|
| `LISTEN` | 端口正在监听 | 服务正常启动 | 端口未监听=服务未启动 |
| `ESTABLISHED` | 连接已建立 | 正常通信中 | 数量过多可能有问题 |
| `TIME_WAIT` | 连接关闭等待 | 正常关闭过程 | 数量过多影响性能 |
| `CLOSE_WAIT` | 等待关闭 | 短暂出现正常 | 长期存在=程序bug |

### 3.2 netstat输出格式解析


**🖥️ 典型输出示例**
```bash
$ netstat -tlnp
Proto Recv-Q Send-Q Local Address    Foreign Address    State    PID/Program
tcp   0      0      0.0.0.0:22       0.0.0.0:*          LISTEN   1234/sshd
tcp   0      0      127.0.0.1:3306   0.0.0.0:*          LISTEN   5678/mysql
tcp   0      0      192.168.1.10:80  192.168.1.20:5432 ESTABLISHED 9012/nginx
```

**📋 字段含义解释**
```
Proto        → 协议类型 (tcp/udp)
Recv-Q       → 接收队列中的数据量 (应该是0)
Send-Q       → 发送队列中的数据量 (应该是0)
Local Address → 本地地址:端口
Foreign Address → 远程地址:端口 (*表示任意)
State        → 连接状态
PID/Program  → 进程ID/程序名
```

> 💡 **理解技巧**
> 
> **Local Address** 就是"我家地址"，**Foreign Address** 就是"对方家地址"
> - `0.0.0.0:80` = 我家80端口对所有人开放
> - `127.0.0.1:3306` = 我家3306端口只对本地开放

### 3.3 异常状态诊断


**🚨 需要关注的异常状态**

```
🔴 CLOSE_WAIT状态过多：
问题：程序没有正确关闭socket
影响：文件描述符耗尽，影响新连接
解决：检查应用程序代码

🔴 TIME_WAIT状态过多：
问题：短连接过多或连接关闭频繁
影响：端口资源耗尽
解决：优化应用使用长连接，调整系统参数

🔴 Recv-Q/Send-Q不为0：
问题：数据积压，网络拥塞
影响：响应变慢
解决：检查网络性能或应用处理能力
```

---

## 4. 🔌 端口与服务识别技巧


### 4.1 监听端口分析


**🔎 查看系统监听端口**
```bash
# 查看所有监听端口
netstat -tlnp

# 只看特定协议
netstat -tlnp | grep tcp    # TCP端口
netstat -ulnp | grep udp    # UDP端口
```

**📊 端口分类理解**
```
端口范围分类：
┌─────────────┬─────────────┬──────────────┐
│ 1-1023      │ 1024-49151  │ 49152-65535  │
│ 系统端口    │ 注册端口    │ 动态端口     │
│ 需要root    │ 应用服务    │ 客户端连接   │
└─────────────┴─────────────┴──────────────┘
```

### 4.2 常见服务端口识别


**🏷️ 标准服务端口对照表**

| 端口 | 服务 | 协议 | 说明 |
|------|------|------|------|
| 22 | SSH | TCP | 远程登录 |
| 80 | HTTP | TCP | Web服务 |
| 443 | HTTPS | TCP | 安全Web服务 |
| 3306 | MySQL | TCP | 数据库 |
| 6379 | Redis | TCP | 缓存数据库 |
| 53 | DNS | UDP | 域名解析 |

**🔍 服务识别实例**
```bash
# 找出谁在使用80端口
$ netstat -tlnp | grep :80
tcp  0  0  0.0.0.0:80  0.0.0.0:*  LISTEN  1234/nginx

# 检查MySQL是否启动
$ netstat -tlnp | grep :3306
tcp  0  0  127.0.0.1:3306  0.0.0.0:*  LISTEN  5678/mysql

# 看看SSH服务状态
$ netstat -tlnp | grep :22
tcp  0  0  0.0.0.0:22  0.0.0.0:*  LISTEN  999/sshd
```

### 4.3 端口占用问题解决


**🛠️ 端口占用排查流程**
```
步骤1：确认端口被占用
netstat -tlnp | grep :端口号

步骤2：找到占用进程
记录PID/Program字段信息

步骤3：决定处理方式
- 正常服务 → 检查配置
- 异常进程 → kill掉进程
- 需要端口 → 修改配置使用其他端口
```

**⚡ 快速解决示例**
```bash
# 端口8080被占用，找出并处理
$ netstat -tlnp | grep :8080
tcp  0  0  0.0.0.0:8080  0.0.0.0:*  LISTEN  12345/java

# 如果是异常进程，可以终止
$ kill 12345

# 确认端口释放
$ netstat -tlnp | grep :8080
# (无输出表示端口已释放)
```

---

## 5. 📈 网络统计信息解读


### 5.1 接口统计信息


**📊 网络接口状态查看**
```bash
# 查看网络接口统计
$ netstat -i
Iface   MTU  RX-OK  RX-ERR  RX-DRP  TX-OK  TX-ERR  TX-DRP  Flg
eth0    1500 123456 0       0       98765  0       0       BMRU
lo      65536 1000   0       0       1000   0       0       LRU
```

**📋 字段含义解释**
```
Iface    → 接口名称 (eth0=网卡, lo=本地回环)
MTU      → 最大传输单元 (通常1500字节)
RX-OK    → 接收成功的包数量
RX-ERR   → 接收错误的包数量  ⚠️关注点
RX-DRP   → 接收丢弃的包数量  ⚠️关注点
TX-OK    → 发送成功的包数量
TX-ERR   → 发送错误的包数量  ⚠️关注点
TX-DRP   → 发送丢弃的包数量  ⚠️关注点
Flg      → 接口标志位
```

> 🚨 **异常指标警告**
> 
> **RX-ERR, RX-DRP, TX-ERR, TX-DRP** 这些值应该是0或很小
> 如果数值较大，说明网络存在问题：
> - 硬件故障
> - 网络拥塞
> - 驱动问题

### 5.2 协议统计信息


**📊 内核网络统计**
```bash
# 查看详细的协议统计
netstat -s
```

**🔍 重要统计指标**
```
TCP统计信息关注点：
- 重传包数量 (Retransmitted segments)
- 连接重置数量 (Reset connections)
- 连接超时数量 (Connection timeouts)

UDP统计信息关注点：
- 丢包数量 (Packet drops)
- 错误包数量 (Packet errors)

ICMP统计信息：
- ping响应统计
- 错误消息统计
```

---

## 6. 🗺️ 路由表与接口分析


### 6.1 路由表信息查看


**🛣️ 系统路由表**
```bash
# 查看路由表
$ netstat -rn
Destination     Gateway         Genmask         Flags   Iface
0.0.0.0         192.168.1.1     0.0.0.0         UG      eth0
192.168.1.0     0.0.0.0         255.255.255.0   U       eth0
127.0.0.0       0.0.0.0         255.0.0.0       U       lo
```

**📋 路由表字段解释**
```
Destination → 目标网络地址
Gateway     → 网关地址 (0.0.0.0表示直连)
Genmask     → 子网掩码
Flags       → 路由标志
  U = 路由可用 (Up)
  G = 通过网关 (Gateway)
  H = 主机路由 (Host)
Iface       → 出口网络接口
```

> 💡 **路由理解技巧**
> 
> 把路由表想象成**快递分拣表**：
> - 目标地址 = 快递要去哪
> - 网关 = 下一个中转站
> - 接口 = 从哪个门发出去

### 6.2 多播组信息


**📡 查看多播组成员**
```bash
# 查看系统加入的多播组
netstat -gn
```

**🔸 多播应用场景**
- 视频流媒体传输
- 网络发现协议
- 集群节点通信

---

## 7. 🆚 netstat vs ss命令对比


### 7.1 性能与功能对比


**⚖️ 详细对比表**

| 对比项目 | netstat | ss | 推荐使用 |
|----------|---------|-----|----------|
| **执行速度** | 慢 (读取/proc文件) | 快 (直接查询内核) | 🏆 ss |
| **内存占用** | 高 | 低 | 🏆 ss |
| **功能丰富度** | 标准功能 | 更多高级功能 | 🏆 ss |
| **学习成本** | 低 (经典工具) | 中等 | ⚖️ 平手 |
| **兼容性** | 所有系统都有 | 较新系统才有 | 🏆 netstat |

### 7.2 命令对照表


**🔄 常用命令转换**

| 功能 | netstat | ss |
|------|---------|-----|
| 查看所有TCP连接 | `netstat -tn` | `ss -tn` |
| 查看监听端口 | `netstat -tln` | `ss -tln` |
| 显示进程信息 | `netstat -tlnp` | `ss -tlnp` |
| 查看统计信息 | `netstat -s` | `ss -s` |

### 7.3 使用建议


**🎯 选择策略**
```
选择netstat的情况：
✅ 旧系统兼容性要求
✅ 团队熟悉度高
✅ 脚本移植性要求

选择ss的情况：
✅ 性能要求高
✅ 连接数量大
✅ 需要高级过滤功能
```

> 📝 **学习建议**
> 
> 作为新手，建议两个都学：
> 1. **先学netstat** - 概念更容易理解
> 2. **再学ss** - 掌握现代化工具
> 3. **根据实际情况选择使用**

---

## 8. 🛠️ 实战应用场景


### 8.1 服务启动检查


**🔧 场景：检查Web服务是否正常启动**
```bash
# 1. 检查80端口是否在监听
$ netstat -tlnp | grep :80
tcp  0  0  0.0.0.0:80  0.0.0.0:*  LISTEN  1234/nginx

# 2. 如果没有输出，说明服务没启动
# 3. 检查服务状态和启动服务
$ systemctl status nginx
$ systemctl start nginx
```

### 8.2 网络连接排查


**🔍 场景：网站访问慢，排查连接问题**
```bash
# 1. 查看当前连接数
$ netstat -tn | grep :80 | wc -l
150

# 2. 查看连接状态分布
$ netstat -tn | grep :80 | awk '{print $6}' | sort | uniq -c
    100 ESTABLISHED
     30 TIME_WAIT
     20 CLOSE_WAIT

# 3. 如果CLOSE_WAIT过多，可能是应用程序问题
```

### 8.3 安全检查


**🛡️ 场景：检查系统是否有异常连接**
```bash
# 1. 查看所有对外连接
$ netstat -tn | grep ESTABLISHED

# 2. 查看是否有可疑的监听端口
$ netstat -tlnp | grep -v -E ':(22|80|443|3306)'

# 3. 检查网络统计是否有异常
$ netstat -s | grep -i error
```

### 8.4 性能调优


**⚡ 场景：系统网络性能调优**
```bash
# 1. 检查TIME_WAIT连接数
$ netstat -tn | grep TIME_WAIT | wc -l

# 2. 如果过多，考虑调优参数
# 3. 查看接口错误统计
$ netstat -i
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 netstat是经典的网络诊断工具
🔸 最常用组合：netstat -tulnp
🔸 重点关注LISTEN和ESTABLISHED状态
🔸 通过PID/Program字段识别服务
🔸 Recv-Q和Send-Q应该是0
🔸 ss是netstat的现代化替代品
```

### 9.2 关键参数记忆


**🧠 记忆口诀**
```
-t TCP连接要看清
-u UDP协议不能停  
-l Listen监听是重点
-n Number数字最分明
-p Process进程要识别
```

### 9.3 实战应用价值


**🎯 日常运维场景**
- **服务检查**：确认服务是否正常启动和监听
- **端口排查**：解决端口占用和冲突问题
- **性能分析**：发现网络瓶颈和异常连接
- **安全审计**：检查可疑的网络连接和监听端口
- **故障诊断**：快速定位网络通信问题

**🔧 最佳实践**
- 监控脚本中使用`-n`参数避免DNS解析延迟
- 结合`grep`和`awk`进行数据过滤和统计
- 定期检查异常状态的连接数量
- 在生产环境逐步迁移到ss命令

**📝 学习检查清单**
- [ ] 能熟练使用netstat -tulnp查看网络连接
- [ ] 能解读netstat输出的各个字段含义
- [ ] 能识别常见的TCP连接状态
- [ ] 能通过端口号找到对应的服务进程
- [ ] 能发现和解决端口占用问题
- [ ] 了解netstat和ss命令的区别和选择策略

**核心记忆**：
> netstat是网络诊断的瑞士军刀，-tulnp组合走天下，
> 看端口找服务，查状态析问题，运维必备好帮手！