---
title: 15ã€Linuxç½‘ç»œç¼–ç¨‹å·¥å…·ä¸åº“
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿè°ƒç”¨ä¸glibcåº“å‡½æ•°å¯¹åº”](#1-ç³»ç»Ÿè°ƒç”¨ä¸glibcåº“å‡½æ•°å¯¹åº”)
2. [libeventäº‹ä»¶åº“ä½¿ç”¨](#2-libeventäº‹ä»¶åº“ä½¿ç”¨)
3. [libevé«˜æ€§èƒ½äº‹ä»¶åº“](#3-libevé«˜æ€§èƒ½äº‹ä»¶åº“)
4. [ç½‘ç»œç¼–ç¨‹å¸¸ç”¨å·¥å…·é›†](#4-ç½‘ç»œç¼–ç¨‹å¸¸ç”¨å·¥å…·é›†)
5. [æ€§èƒ½åˆ†æä¸è°ƒä¼˜å·¥å…·](#5-æ€§èƒ½åˆ†æä¸è°ƒä¼˜å·¥å…·)
6. [å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·](#6-å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·)
7. [ç½‘ç»œç¼–ç¨‹å¼€å‘ç¯å¢ƒé…ç½®](#7-ç½‘ç»œç¼–ç¨‹å¼€å‘ç¯å¢ƒé…ç½®)
8. [è·¨å¹³å°ç½‘ç»œç¼–ç¨‹æ³¨æ„äº‹é¡¹](#8-è·¨å¹³å°ç½‘ç»œç¼–ç¨‹æ³¨æ„äº‹é¡¹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ ç³»ç»Ÿè°ƒç”¨ä¸glibcåº“å‡½æ•°å¯¹åº”


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿè°ƒç”¨å’Œglibc


ğŸ’­ **å…ˆç†è§£åŸºæœ¬æ¦‚å¿µ**ï¼š
- **ç³»ç»Ÿè°ƒç”¨**ï¼šç¨‹åºå‘å†…æ ¸è¯·æ±‚æœåŠ¡çš„æ¥å£ï¼Œå°±åƒä½ å»é“¶è¡ŒåŠäº‹è¦å¡«è¡¨æ ¼
- **glibcåº“å‡½æ•°**ï¼šå¯¹ç³»ç»Ÿè°ƒç”¨çš„å°è£…ï¼Œå°±åƒé“¶è¡ŒæŸœå‘˜å¸®ä½ å¡«è¡¨æ ¼ï¼Œæ›´æ–¹ä¾¿ä½¿ç”¨

ğŸ—ï¸ **è°ƒç”¨å±‚æ¬¡ç»“æ„**
```
åº”ç”¨ç¨‹åº
    â†“
glibcåº“å‡½æ•° (ç”¨æˆ·ç©ºé—´)
    â†“
ç³»ç»Ÿè°ƒç”¨æ¥å£
    â†“
å†…æ ¸ (å†…æ ¸ç©ºé—´)
    â†“
ç¡¬ä»¶
```

### 1.2 æ ¸å¿ƒç½‘ç»œç³»ç»Ÿè°ƒç”¨å¯¹åº”å…³ç³»


| **åŠŸèƒ½** | **ç³»ç»Ÿè°ƒç”¨** | **glibcåº“å‡½æ•°** | **è¯´æ˜** |
|---------|-------------|---------------|----------|
| åˆ›å»ºå¥—æ¥å­— | `sys_socket` | `socket()` | åˆ›å»ºç½‘ç»œé€šä¿¡ç«¯ç‚¹ |
| ç»‘å®šåœ°å€ | `sys_bind` | `bind()` | å°†å¥—æ¥å­—ç»‘å®šåˆ°åœ°å€ |
| ç›‘å¬è¿æ¥ | `sys_listen` | `listen()` | è®¾ç½®ä¸ºç›‘å¬çŠ¶æ€ |
| æ¥å—è¿æ¥ | `sys_accept` | `accept()` | æ¥å—å®¢æˆ·ç«¯è¿æ¥ |
| è¿æ¥æœåŠ¡å™¨ | `sys_connect` | `connect()` | è¿æ¥åˆ°æœåŠ¡å™¨ |
| å‘é€æ•°æ® | `sys_sendto` | `send()/sendto()` | å‘é€æ•°æ® |
| æ¥æ”¶æ•°æ® | `sys_recvfrom` | `recv()/recvfrom()` | æ¥æ”¶æ•°æ® |

ğŸ¤” **ä¸ºä»€ä¹ˆéœ€è¦glibcå°è£…**ï¼š
- **é”™è¯¯å¤„ç†**ï¼šglibcä¼šè®¾ç½®`errno`é”™è¯¯ç ï¼Œæ–¹ä¾¿è°ƒè¯•
- **å‚æ•°æ£€æŸ¥**ï¼šglibcä¼šåšåŸºæœ¬çš„å‚æ•°åˆæ³•æ€§æ£€æŸ¥
- **è·¨å¹³å°**ï¼šglibcå±è”½äº†ä¸åŒæ¶æ„çš„å·®å¼‚
- **ä¾¿åˆ©åŠŸèƒ½**ï¼šæä¾›äº†æ›´å¤šä¾¿åˆ©çš„åŠŸèƒ½å‡½æ•°

### 1.3 å®é™…ç¼–ç¨‹ä¸­çš„ä½¿ç”¨


```c
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>

// åˆ›å»ºTCPå¥—æ¥å­—çš„æ ‡å‡†æµç¨‹
int create_tcp_server(int port) {
    // 1. åˆ›å»ºå¥—æ¥å­— - å¯¹åº”sys_socketç³»ç»Ÿè°ƒç”¨
    int sockfd = socket(AF_INET, SOCK_STREAM, 0);
    if (sockfd < 0) {
        perror("socket"); // glibcè®¾ç½®çš„é”™è¯¯ä¿¡æ¯
        return -1;
    }
    
    // 2. ç»‘å®šåœ°å€ - å¯¹åº”sys_bindç³»ç»Ÿè°ƒç”¨
    struct sockaddr_in addr;
    addr.sin_family = AF_INET;
    addr.sin_port = htons(port);
    addr.sin_addr.s_addr = INADDR_ANY;
    
    if (bind(sockfd, (struct sockaddr*)&addr, sizeof(addr)) < 0) {
        perror("bind");
        close(sockfd);
        return -1;
    }
    
    // 3. ç›‘å¬ - å¯¹åº”sys_listenç³»ç»Ÿè°ƒç”¨
    if (listen(sockfd, 128) < 0) {
        perror("listen");
        close(sockfd);
        return -1;
    }
    
    return sockfd;
}
```

---

## 2. âš¡ libeventäº‹ä»¶åº“ä½¿ç”¨


### 2.1 libeventæ˜¯ä»€ä¹ˆ


ğŸ·ï¸ **libevent** = è·¨å¹³å°çš„äº‹ä»¶é©±åŠ¨ç¼–ç¨‹åº“

ğŸ’¡ **è§£å†³ä»€ä¹ˆé—®é¢˜**ï¼š
ä¼ ç»Ÿçš„ç½‘ç»œç¼–ç¨‹è¦å¤„ç†å¾ˆå¤šè¿æ¥æ—¶ï¼Œéœ€è¦ä¸æ–­æ£€æŸ¥æ¯ä¸ªè¿æ¥çš„çŠ¶æ€ï¼Œå°±åƒä¸€ä¸ªæœåŠ¡å‘˜è¦ä¸åœåœ°è·‘åˆ°æ¯æ¡Œå»é—®"éœ€è¦ä»€ä¹ˆæœåŠ¡å—ï¼Ÿ"ï¼Œæ•ˆç‡å¾ˆä½ã€‚

libeventå°±åƒä¸€ä¸ªæ™ºèƒ½çš„æœåŠ¡ç³»ç»Ÿï¼Œå®¢æˆ·æœ‰éœ€è¦æ—¶ä¼šä¸»åŠ¨é€šçŸ¥ä½ ï¼Œä½ åªéœ€è¦å“åº”é€šçŸ¥å³å¯ã€‚

### 2.2 libeventæ ¸å¿ƒæ¦‚å¿µ


ğŸ”¢ **ä¸»è¦ç»„ä»¶**ï¼š
1. **event_base**ï¼šäº‹ä»¶å¾ªç¯çš„æ ¸å¿ƒï¼Œç®¡ç†æ‰€æœ‰äº‹ä»¶
2. **event**ï¼šå…·ä½“çš„äº‹ä»¶å¯¹è±¡ï¼Œæ¯”å¦‚"å¥—æ¥å­—å¯è¯»"
3. **å›è°ƒå‡½æ•°**ï¼šäº‹ä»¶å‘ç”Ÿæ—¶è¦æ‰§è¡Œçš„ä»£ç 

ğŸŒ° **ä¸¾ä¸ªä¾‹å­**ï¼š
```c
#include <event2/event.h>
#include <event2/listener.h>

// å½“æœ‰æ–°è¿æ¥æ—¶çš„å›è°ƒå‡½æ•°
void accept_conn_cb(struct evconnlistener *listener,
                   evutil_socket_t fd, struct sockaddr *address, 
                   int socklen, void *ctx) {
    printf("æ¥æ”¶åˆ°æ–°è¿æ¥ï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼š%d\n", fd);
    
    // è¿™é‡Œå¯ä»¥ä¸ºæ–°è¿æ¥åˆ›å»ºè¯»å†™äº‹ä»¶
    struct event_base *base = evconnlistener_get_base(listener);
    // ... å¤„ç†æ–°è¿æ¥çš„é€»è¾‘
}

int main() {
    // 1. åˆ›å»ºäº‹ä»¶å¾ªç¯
    struct event_base *base = event_base_new();
    
    // 2. åˆ›å»ºç›‘å¬å™¨
    struct sockaddr_in sin = {0};
    sin.sin_family = AF_INET;
    sin.sin_port = htons(8080);
    sin.sin_addr.s_addr = INADDR_ANY;
    
    struct evconnlistener *listener = evconnlistener_new_bind(
        base, accept_conn_cb, NULL,
        LEV_OPT_CLOSE_ON_FREE | LEV_OPT_REUSEABLE,
        -1, (struct sockaddr*)&sin, sizeof(sin));
    
    // 3. å¯åŠ¨äº‹ä»¶å¾ªç¯
    event_base_dispatch(base);
    
    return 0;
}
```

### 2.3 libeventçš„ä¼˜åŠ¿


âœ… **ä¸»è¦ä¼˜ç‚¹**ï¼š
- **è·¨å¹³å°**ï¼šLinuxç”¨epollï¼ŒWindowsç”¨IOCPï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æœºåˆ¶
- **é«˜æ€§èƒ½**ï¼šé¿å…äº†è½®è¯¢ï¼Œä½¿ç”¨äº‹ä»¶é€šçŸ¥æœºåˆ¶
- **æ˜“ç”¨æ€§**ï¼šæä¾›äº†é«˜çº§APIï¼Œç®€åŒ–å¼€å‘
- **ç¨³å®šæ€§**ï¼šè¢«å¹¿æ³›ä½¿ç”¨ï¼Œç»è¿‡å……åˆ†æµ‹è¯•

ğŸ“Š **æ€§èƒ½å¯¹æ¯”**ï¼š
| **å¤„ç†æ–¹å¼** | **1000ä¸ªè¿æ¥** | **10000ä¸ªè¿æ¥** | **é€‚ç”¨åœºæ™¯** |
|-------------|---------------|----------------|-------------|
| ä¼ ç»Ÿè½®è¯¢ | å¯æ¥å— | æ€§èƒ½ä¸‹é™æ˜æ˜¾ | å°è§„æ¨¡åº”ç”¨ |
| libevent | ä¼˜ç§€ | ä¾ç„¶ä¼˜ç§€ | é«˜å¹¶å‘æœåŠ¡å™¨ |

---

## 3. ğŸš€ libevé«˜æ€§èƒ½äº‹ä»¶åº“


### 3.1 libevä¸libeventçš„åŒºåˆ«


ğŸ”„ **ä¸¤è€…å¯¹æ¯”**ï¼š

| **ç‰¹æ€§** | **libevent** | **libev** |
|---------|-------------|----------|
| è®¾è®¡ç†å¿µ | åŠŸèƒ½ä¸°å¯Œï¼Œæ˜“ç”¨æ€§ä¼˜å…ˆ | æ€§èƒ½ä¼˜å…ˆï¼Œè½»é‡çº§ |
| å†…å­˜å ç”¨ | ç›¸å¯¹è¾ƒå¤§ | æ›´å° |
| æ€§èƒ½ | é«˜æ€§èƒ½ | æè‡´æ€§èƒ½ |
| å­¦ä¹ éš¾åº¦ | è¾ƒå®¹æ˜“ | ç›¸å¯¹è¾ƒéš¾ |
| é€‚ç”¨åœºæ™¯ | ä¸€èˆ¬é«˜æ€§èƒ½åº”ç”¨ | å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯ |

ğŸ’­ **ç®€å•ç†è§£**ï¼š
- **libevent**ï¼šåƒä¸€è¾†é…ç½®é½å…¨çš„SUVï¼ŒåŠŸèƒ½å¤šï¼Œæ˜“å¼€ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯
- **libev**ï¼šåƒä¸€è¾†F1èµ›è½¦ï¼Œé€Ÿåº¦æå¿«ï¼Œä½†éœ€è¦ä¸“ä¸šæŠ€èƒ½é©¾é©­

### 3.2 libevåŸºæœ¬ä½¿ç”¨


```c
#include <ev.h>

// å®šä¹‰ä¸€ä¸ªIOè§‚å¯Ÿè€…
struct ev_io socket_watcher;

// IOäº‹ä»¶å›è°ƒå‡½æ•°
static void socket_cb(EV_P_ ev_io *w, int revents) {
    if (revents & EV_READ) {
        // å¥—æ¥å­—å¯è¯»
        char buffer[1024];
        int n = recv(w->fd, buffer, sizeof(buffer), 0);
        if (n > 0) {
            printf("æ¥æ”¶åˆ°æ•°æ®ï¼š%.*s\n", n, buffer);
        }
    }
}

int main() {
    // 1. åˆ›å»ºäº‹ä»¶å¾ªç¯
    struct ev_loop *loop = ev_default_loop(0);
    
    // 2. åˆå§‹åŒ–IOè§‚å¯Ÿè€…
    ev_io_init(&socket_watcher, socket_cb, sockfd, EV_READ);
    
    // 3. å¯åŠ¨è§‚å¯Ÿè€…
    ev_io_start(loop, &socket_watcher);
    
    // 4. è¿è¡Œäº‹ä»¶å¾ªç¯
    ev_run(loop, 0);
    
    return 0;
}
```

### 3.3 libevçš„è§‚å¯Ÿè€…ç±»å‹


ğŸ” **å¸¸ç”¨è§‚å¯Ÿè€…**ï¼š

| **è§‚å¯Ÿè€…ç±»å‹** | **ç›‘å¬äº‹ä»¶** | **ä½¿ç”¨åœºæ™¯** |
|---------------|-------------|-------------|
| `ev_io` | æ–‡ä»¶æè¿°ç¬¦è¯»å†™ | ç½‘ç»œIOã€æ–‡ä»¶IO |
| `ev_timer` | å®šæ—¶å™¨ | è¶…æ—¶å¤„ç†ã€å®šæœŸä»»åŠ¡ |
| `ev_signal` | ä¿¡å· | ä¼˜é›…å…³é—­ã€ä¿¡å·å¤„ç† |
| `ev_child` | å­è¿›ç¨‹çŠ¶æ€ | è¿›ç¨‹ç®¡ç† |
| `ev_stat` | æ–‡ä»¶çŠ¶æ€å˜åŒ– | é…ç½®æ–‡ä»¶ç›‘æ§ |

---

## 4. ğŸ› ï¸ ç½‘ç»œç¼–ç¨‹å¸¸ç”¨å·¥å…·é›†


### 4.1 ç½‘ç»œè°ƒè¯•å·¥å…·


ğŸ“‹ **å¿…å¤‡è°ƒè¯•å·¥å…·**ï¼š

| **å·¥å…·** | **ä¸»è¦åŠŸèƒ½** | **å¸¸ç”¨å‘½ä»¤** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|-------------|-------------|
| `netcat (nc)` | ç½‘ç»œè¿æ¥æµ‹è¯• | `nc -l 8080` | ç«¯å£ç›‘å¬ã€æ•°æ®ä¼ è¾“æµ‹è¯• |
| `telnet` | è¿œç¨‹è¿æ¥æµ‹è¯• | `telnet host port` | åè®®æµ‹è¯•ã€è¿æ¥éªŒè¯ |
| `curl` | HTTPè¯·æ±‚æµ‹è¯• | `curl -v url` | REST APIæµ‹è¯• |
| `wget` | æ–‡ä»¶ä¸‹è½½æµ‹è¯• | `wget url` | ä¸‹è½½åŠŸèƒ½æµ‹è¯• |

ğŸŒ° **å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# æµ‹è¯•ç«¯å£æ˜¯å¦å¼€æ”¾
nc -zv google.com 80

# åˆ›å»ºç®€å•çš„HTTPæœåŠ¡å™¨
while true; do echo -e "HTTP/1.1 200 OK\n\nHello World" | nc -l 8080; done

# æµ‹è¯•HTTPæ¥å£
curl -X POST -H "Content-Type: application/json" \
     -d '{"key":"value"}' http://localhost:8080/api
```

### 4.2 ç½‘ç»œç›‘æ§å·¥å…·


ğŸ” **ç½‘ç»œçŠ¶æ€ç›‘æ§**ï¼š

| **å·¥å…·** | **ç›‘æ§å†…å®¹** | **å…³é”®é€‰é¡¹** |
|---------|------------|-------------|
| `netstat` | ç½‘ç»œè¿æ¥çŠ¶æ€ | `-tlnp`ï¼ˆç›‘å¬ç«¯å£ï¼‰ |
| `ss` | ç°ä»£ç‰ˆnetstat | `-tlnp`ï¼ˆæ›´å¿«çš„netstatï¼‰ |
| `lsof` | æ–‡ä»¶å’Œç½‘ç»œæè¿°ç¬¦ | `-i:port`ï¼ˆç«¯å£ä½¿ç”¨æƒ…å†µï¼‰ |
| `iftop` | å®æ—¶ç½‘ç»œæµé‡ | æŒ‰è¿æ¥æ˜¾ç¤ºæµé‡ |
| `nload` | ç½‘ç»œæ¥å£æµé‡ | å®æ—¶å¸¦å®½ç›‘æ§ |

âš¡ **å¿«é€Ÿè¯Šæ–­å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰ç›‘å¬ç«¯å£
ss -tlnp

# æŸ¥çœ‹æŒ‡å®šç«¯å£çš„ä½¿ç”¨æƒ…å†µ
lsof -i:8080

# æŸ¥çœ‹ç½‘ç»œè¿æ¥æ•°
ss -s

# å®æ—¶ç›‘æ§ç½‘ç»œè¿æ¥
watch -n1 'ss -tuln'
```

### 4.3 ç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·


ğŸ“ˆ **æ€§èƒ½æµ‹è¯•å¥—ä»¶**ï¼š

ğŸ† **iperf3** - ç½‘ç»œå¸¦å®½æµ‹è¯•ä¹‹ç‹
```bash
# æœåŠ¡å™¨ç«¯
iperf3 -s

# å®¢æˆ·ç«¯æµ‹è¯•
iperf3 -c server_ip -t 30  # æµ‹è¯•30ç§’
iperf3 -c server_ip -P 4   # 4ä¸ªå¹¶è¡Œè¿æ¥
```

ğŸ¯ **ab (Apache Bench)** - HTTPå‹åŠ›æµ‹è¯•
```bash
# 1000ä¸ªè¯·æ±‚ï¼Œ10ä¸ªå¹¶å‘
ab -n 1000 -c 10 http://localhost:8080/

# å¸¦è®¤è¯çš„æµ‹è¯•
ab -n 100 -c 5 -H "Authorization: Bearer token" http://api.example.com/
```

---

## 5. ğŸ“Š æ€§èƒ½åˆ†æä¸è°ƒä¼˜å·¥å…·


### 5.1 CPUæ€§èƒ½åˆ†æ


ğŸ” **CPUä½¿ç”¨åˆ†æå·¥å…·**ï¼š

**perf** - Linuxæ€§èƒ½åˆ†æç¥å™¨
```bash
# è®°å½•ç¨‹åºè¿è¡ŒæœŸé—´çš„æ€§èƒ½æ•°æ®
perf record -g ./your_program

# åˆ†ææ€§èƒ½æ•°æ®
perf report

# å®æ—¶ç›‘æ§çƒ­ç‚¹å‡½æ•°
perf top
```

**gprof** - å‡½æ•°çº§æ€§èƒ½åˆ†æ
```bash
# ç¼–è¯‘æ—¶åŠ ä¸Šprofilingé€‰é¡¹
gcc -pg -o program program.c

# è¿è¡Œç¨‹åºç”Ÿæˆåˆ†ææ•°æ®
./program

# åˆ†æç»“æœ
gprof program gmon.out > analysis.txt
```

### 5.2 ç½‘ç»œIOæ€§èƒ½åˆ†æ


ğŸ“‹ **IOæ€§èƒ½ç›‘æ§**ï¼š

| **å·¥å…·** | **ç›‘æ§æŒ‡æ ‡** | **å…³é”®å‘½ä»¤** |
|---------|------------|-------------|
| `iotop` | IOä½¿ç”¨ç‡æŒ‰è¿›ç¨‹ | `iotop -o`ï¼ˆåªæ˜¾ç¤ºæœ‰IOçš„è¿›ç¨‹ï¼‰ |
| `iostat` | ç£ç›˜IOç»Ÿè®¡ | `iostat -x 1`ï¼ˆæ¯ç§’åˆ·æ–°ï¼‰ |
| `sar` | ç³»ç»Ÿæ´»åŠ¨æŠ¥å‘Š | `sar -n DEV 1`ï¼ˆç½‘ç»œæ¥å£ç»Ÿè®¡ï¼‰ |

âš¡ **ç½‘ç»œå»¶è¿Ÿåˆ†æ**ï¼š
```bash
# æµ‹è¯•ç½‘ç»œå»¶è¿Ÿ
ping -c 10 target_host

# è·¯ç”±è·Ÿè¸ª
traceroute target_host

# é«˜çº§ç½‘ç»œè¯Šæ–­
mtr target_host  # ç»“åˆpingå’Œtraceroute
```

### 5.3 ç³»ç»Ÿçº§æ€§èƒ½è°ƒä¼˜


ğŸ¯ **å…³é”®ç³»ç»Ÿå‚æ•°**ï¼š

**TCPå‚æ•°è°ƒä¼˜**
```bash
# æŸ¥çœ‹å½“å‰TCPå‚æ•°
sysctl net.ipv4.tcp_congestion_control
sysctl net.core.rmem_max

# ä¼˜åŒ–é«˜å¹¶å‘åœºæ™¯çš„å‚æ•°
echo 'net.core.somaxconn = 65535' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_max_syn_backlog = 65535' >> /etc/sysctl.conf
echo 'net.core.rmem_max = 134217728' >> /etc/sysctl.conf

# åº”ç”¨é…ç½®
sysctl -p
```

---

## 6. ğŸ” å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·


### 6.1 Valgrindå†…å­˜æ£€æµ‹


ğŸ”§ **Valgrind** = å†…å­˜é”™è¯¯æ£€æµ‹çš„ä¸“ä¸šå·¥å…·

ğŸ’­ **ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼**ï¼š
ç¨‹åºç”³è¯·äº†å†…å­˜ä½†å¿˜è®°é‡Šæ”¾ï¼Œå°±åƒå€Ÿä¹¦ä¸è¿˜ï¼Œæ—¶é—´é•¿äº†å›¾ä¹¦é¦†çš„ä¹¦å°±ä¸å¤Ÿç”¨äº†ã€‚

ğŸŒ° **åŸºæœ¬ä½¿ç”¨**ï¼š
```bash
# ç¼–è¯‘ç¨‹åºï¼ˆå»ºè®®åŠ ä¸Šè°ƒè¯•ä¿¡æ¯ï¼‰
gcc -g -o program program.c

# ä½¿ç”¨valgrindæ£€æµ‹å†…å­˜æ³„æ¼
valgrind --leak-check=full --show-leak-kinds=all ./program

# æ£€æµ‹æœªåˆå§‹åŒ–çš„å†…å­˜è®¿é—®
valgrind --tool=memcheck ./program
```

**è¾“å‡ºè§£è¯»**ï¼š
```
==12345== HEAP SUMMARY:
==12345==     in use at exit: 1,024 bytes in 1 blocks
==12345==   total heap usage: 2 allocs, 1 frees, 2,048 bytes allocated
==12345== 
==12345== 1,024 bytes in 1 blocks are definitely lost in loss record 1 of 1
```

è¿™è¡¨ç¤ºæœ‰1024å­—èŠ‚çš„å†…å­˜ç¡®å®æ³„æ¼äº†ã€‚

### 6.2 AddressSanitizer (ASan)


âš¡ **ASan** = ç¼–è¯‘å™¨å†…ç½®çš„å¿«é€Ÿå†…å­˜æ£€æµ‹å·¥å…·

âœ… **ä¼˜åŠ¿**ï¼š
- **é€Ÿåº¦å¿«**ï¼šæ¯”Valgrindå¿«å¾ˆå¤š
- **æ£€æµ‹å…¨é¢**ï¼šå †æº¢å‡ºã€æ ˆæº¢å‡ºã€ä½¿ç”¨åé‡Šæ”¾ç­‰
- **é›†æˆç®€å•**ï¼šåªéœ€è¦ç¼–è¯‘é€‰é¡¹

```bash
# ç¼–è¯‘æ—¶å¯ç”¨AddressSanitizer
gcc -fsanitize=address -g -o program program.c

# ç›´æ¥è¿è¡Œï¼Œæœ‰é”™è¯¯ä¼šè‡ªåŠ¨æŠ¥å‘Š
./program
```

### 6.3 å¸¸è§å†…å­˜é”™è¯¯ç±»å‹


âš ï¸ **å¿…é¡»é¿å…çš„å†…å­˜é”™è¯¯**ï¼š

| **é”™è¯¯ç±»å‹** | **å…¸å‹åœºæ™¯** | **æ£€æµ‹å·¥å…·** |
|-------------|------------|-------------|
| å†…å­˜æ³„æ¼ | `malloc`åå¿˜è®°`free` | Valgrind, ASan |
| é‡å¤é‡Šæ”¾ | å¯¹åŒä¸€æŒ‡é’ˆå¤šæ¬¡`free` | ASan |
| ä½¿ç”¨å·²é‡Šæ”¾å†…å­˜ | `free`åç»§ç»­ä½¿ç”¨æŒ‡é’ˆ | ASan |
| ç¼“å†²åŒºæº¢å‡º | æ•°ç»„è¶Šç•Œè®¿é—® | ASan |
| æ ˆæº¢å‡º | é€’å½’å¤ªæ·±æˆ–å±€éƒ¨æ•°ç»„å¤ªå¤§ | ASan |

ğŸ› ï¸ **é¢„é˜²æªæ–½**ï¼š
```c
// å¥½çš„å†…å­˜ç®¡ç†ä¹ æƒ¯
char *buffer = malloc(1024);
if (buffer == NULL) {
    // æ€»æ˜¯æ£€æŸ¥mallocè¿”å›å€¼
    return -1;
}

// ä½¿ç”¨å®Œç«‹å³ç½®NULL
free(buffer);
buffer = NULL;  // é˜²æ­¢æ„å¤–ä½¿ç”¨

// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼ˆC++ï¼‰æˆ–RAIIæ¨¡å¼
```

---

## 7. âš™ï¸ ç½‘ç»œç¼–ç¨‹å¼€å‘ç¯å¢ƒé…ç½®


### 7.1 ç¼–è¯‘ç¯å¢ƒé…ç½®


ğŸ”§ **å¿…å¤‡å¼€å‘å·¥å…·å®‰è£…**ï¼š

**Ubuntu/Debianç³»ç»Ÿ**ï¼š
```bash
# åŸºç¡€å¼€å‘å·¥å…·
sudo apt update
sudo apt install build-essential

# ç½‘ç»œç¼–ç¨‹ç›¸å…³åº“
sudo apt install libevent-dev libev-dev
sudo apt install libssl-dev  # SSL/TLSæ”¯æŒ

# è°ƒè¯•å·¥å…·
sudo apt install valgrind gdb
sudo apt install strace ltrace  # ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ª
```

**CentOS/RHELç³»ç»Ÿ**ï¼š
```bash
# å¼€å‘å·¥å…·ç»„
sudo yum groupinstall "Development Tools"

# ç½‘ç»œåº“
sudo yum install libevent-devel libev-devel
sudo yum install openssl-devel

# è°ƒè¯•å·¥å…·
sudo yum install valgrind gdb
```

### 7.2 é¡¹ç›®ç»“æ„ç»„ç»‡


ğŸ“ **æ¨èçš„é¡¹ç›®ç›®å½•ç»“æ„**ï¼š
```
project/
â”œâ”€â”€ src/           # æºä»£ç 
â”‚   â”œâ”€â”€ common/    # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ server/    # æœåŠ¡å™¨ç«¯ä»£ç 
â”‚   â””â”€â”€ client/    # å®¢æˆ·ç«¯ä»£ç 
â”œâ”€â”€ include/       # å¤´æ–‡ä»¶
â”œâ”€â”€ lib/           # é™æ€åº“
â”œâ”€â”€ bin/           # å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ tests/         # æµ‹è¯•ä»£ç 
â”œâ”€â”€ docs/          # æ–‡æ¡£
â”œâ”€â”€ Makefile       # æ„å»ºè„šæœ¬
â””â”€â”€ README.md      # é¡¹ç›®è¯´æ˜
```

### 7.3 Makefileé…ç½®ç¤ºä¾‹


```makefile
# ç¼–è¯‘å™¨è®¾ç½®
CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -g
LDFLAGS = -levent -lssl -lcrypto

# ç›®å½•è®¾ç½®
SRCDIR = src
INCDIR = include
OBJDIR = obj
BINDIR = bin

# æºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶
SOURCES = $(wildcard $(SRCDIR)/*.c)
OBJECTS = $(SOURCES:$(SRCDIR)/%.c=$(OBJDIR)/%.o)
TARGET = $(BINDIR)/server

# é»˜è®¤ç›®æ ‡
all: $(TARGET)

# é“¾æ¥
$(TARGET): $(OBJECTS) | $(BINDIR)
	$(CC) $(OBJECTS) -o $@ $(LDFLAGS)

# ç¼–è¯‘
$(OBJDIR)/%.o: $(SRCDIR)/%.c | $(OBJDIR)
	$(CC) $(CFLAGS) -I$(INCDIR) -c $< -o $@

# åˆ›å»ºç›®å½•
$(OBJDIR):
	mkdir -p $(OBJDIR)

$(BINDIR):
	mkdir -p $(BINDIR)

# æ¸…ç†
clean:
	rm -rf $(OBJDIR) $(BINDIR)

# è°ƒè¯•ç‰ˆæœ¬
debug: CFLAGS += -DDEBUG -fsanitize=address
debug: $(TARGET)

.PHONY: all clean debug
```

---

## 8. ğŸŒ è·¨å¹³å°ç½‘ç»œç¼–ç¨‹æ³¨æ„äº‹é¡¹


### 8.1 å¹³å°å·®å¼‚æ¦‚è§ˆ


ğŸ” **ä¸»è¦å¹³å°å·®å¼‚**ï¼š

| **å·®å¼‚ç‚¹** | **Linux** | **Windows** | **macOS** |
|-----------|-----------|-------------|-----------|
| å¤´æ–‡ä»¶ | `<sys/socket.h>` | `<winsock2.h>` | `<sys/socket.h>` |
| å¥—æ¥å­—ç±»å‹ | `int` | `SOCKET` | `int` |
| é”™è¯¯å¤„ç† | `errno` | `WSAGetLastError()` | `errno` |
| åˆå§‹åŒ– | ä¸éœ€è¦ | `WSAStartup()` | ä¸éœ€è¦ |
| å…³é—­å‡½æ•° | `close()` | `closesocket()` | `close()` |

### 8.2 è·¨å¹³å°å…¼å®¹æ€§å¤„ç†


ğŸ› ï¸ **ç»Ÿä¸€æ¥å£è®¾è®¡**ï¼š

```c
#ifdef _WIN32
    #include <winsock2.h>
    #include <ws2tcpip.h>
    #pragma comment(lib, "ws2_32.lib")
    
    typedef SOCKET socket_t;
    #define CLOSE_SOCKET closesocket
    #define GET_SOCKET_ERROR() WSAGetLastError()
    
    // Windowsåˆå§‹åŒ–
    static int init_network() {
        WSADATA wsaData;
        return WSAStartup(MAKEWORD(2,2), &wsaData);
    }
    
#else
    #include <sys/socket.h>
    #include <netinet/in.h>
    #include <arpa/inet.h>
    #include <unistd.h>
    #include <errno.h>
    
    typedef int socket_t;
    #define CLOSE_SOCKET close
    #define GET_SOCKET_ERROR() errno
    #define INVALID_SOCKET -1
    
    // Unixç³»ç»Ÿä¸éœ€è¦åˆå§‹åŒ–
    static int init_network() { return 0; }
#endif

// è·¨å¹³å°çš„å¥—æ¥å­—åˆ›å»ºå‡½æ•°
socket_t create_socket() {
    socket_t sock = socket(AF_INET, SOCK_STREAM, 0);
    if (sock == INVALID_SOCKET) {
        printf("åˆ›å»ºå¥—æ¥å­—å¤±è´¥ï¼Œé”™è¯¯ç ï¼š%d\n", GET_SOCKET_ERROR());
        return INVALID_SOCKET;
    }
    return sock;
}
```

### 8.3 å­—èŠ‚åºå¤„ç†


ğŸ”„ **ç½‘ç»œå­—èŠ‚åºè½¬æ¢**ï¼š

ğŸ’­ **ä¸ºä»€ä¹ˆéœ€è¦å­—èŠ‚åºè½¬æ¢**ï¼š
ä¸åŒçš„CPUæ¶æ„å­˜å‚¨å¤šå­—èŠ‚æ•°æ®çš„é¡ºåºå¯èƒ½ä¸åŒï¼Œå°±åƒæœ‰äº›åœ°æ–¹å†™æ—¥æœŸæ˜¯"å¹´-æœˆ-æ—¥"ï¼Œæœ‰äº›æ˜¯"æ—¥-æœˆ-å¹´"ï¼Œç½‘ç»œé€šä¿¡éœ€è¦ç»Ÿä¸€æ ¼å¼ã€‚

```c
#include <arpa/inet.h>  // Linux/macOS
// Windowséœ€è¦åŒ…å« <winsock2.h>

// ä¸»æœºå­—èŠ‚åºè½¬ç½‘ç»œå­—èŠ‚åº
uint16_t port_net = htons(8080);  // host to network short
uint32_t addr_net = htonl(addr);  // host to network long

// ç½‘ç»œå­—èŠ‚åºè½¬ä¸»æœºå­—èŠ‚åº
uint16_t port_host = ntohs(port_net);  // network to host short
uint32_t addr_host = ntohl(addr_net);  // network to host long

// å®é™…ä½¿ç”¨ç¤ºä¾‹
struct sockaddr_in server_addr;
server_addr.sin_family = AF_INET;
server_addr.sin_port = htons(8080);           // ç«¯å£è½¬æ¢
server_addr.sin_addr.s_addr = htonl(INADDR_ANY);  // åœ°å€è½¬æ¢
```

### 8.4 ç¼–è¯‘é…ç½®


ğŸ“‹ **CMakeè·¨å¹³å°é…ç½®**ï¼š

```cmake
cmake_minimum_required(VERSION 3.10)
project(NetworkApp)

set(CMAKE_C_STANDARD 99)

# æºæ–‡ä»¶
set(SOURCES src/main.c src/network.c)

# å¹³å°ç‰¹å®šé…ç½®
if(WIN32)
    # Windowsç‰¹å®šè®¾ç½®
    target_link_libraries(${PROJECT_NAME} ws2_32)
    target_compile_definitions(${PROJECT_NAME} PRIVATE _WIN32_WINNT=0x0601)
elseif(APPLE)
    # macOSç‰¹å®šè®¾ç½®
    find_library(CORE_FOUNDATION CoreFoundation)
    target_link_libraries(${PROJECT_NAME} ${CORE_FOUNDATION})
else()
    # Linuxç‰¹å®šè®¾ç½®
    target_link_libraries(${PROJECT_NAME} pthread)
endif()

# æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶
add_executable(${PROJECT_NAME} ${SOURCES})
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒçŸ¥è¯†


ğŸ¯ **ç³»ç»Ÿè°ƒç”¨ä¸åº“å‡½æ•°**ï¼š
- ç†è§£ç³»ç»Ÿè°ƒç”¨æ˜¯å†…æ ¸æ¥å£ï¼Œglibcæ˜¯ç”¨æˆ·å‹å¥½çš„å°è£…
- æŒæ¡ä¸»è¦ç½‘ç»œç³»ç»Ÿè°ƒç”¨çš„å¯¹åº”å…³ç³»
- å­¦ä¼šä½¿ç”¨glibcæä¾›çš„é”™è¯¯å¤„ç†æœºåˆ¶

âš¡ **äº‹ä»¶é©±åŠ¨ç¼–ç¨‹**ï¼š
- **libevent**ï¼šåŠŸèƒ½ä¸°å¯Œï¼Œæ˜“ç”¨æ€§å¥½ï¼Œé€‚åˆå¤§å¤šæ•°åº”ç”¨
- **libev**ï¼šæ€§èƒ½æè‡´ï¼Œè½»é‡çº§ï¼Œé€‚åˆé«˜æ€§èƒ½åœºæ™¯
- ç†è§£äº‹ä»¶é©±åŠ¨æ¯”ä¼ ç»Ÿè½®è¯¢çš„ä¼˜åŠ¿

ğŸ› ï¸ **å¼€å‘è°ƒè¯•å·¥å…·**ï¼š
- **ç½‘ç»œè°ƒè¯•**ï¼šncã€telnetã€curlæ˜¯åŸºæœ¬æŠ€èƒ½
- **æ€§èƒ½åˆ†æ**ï¼šperfã€iotopã€saræŒæ¡ç³»ç»Ÿæ€§èƒ½
- **å†…å­˜æ£€æµ‹**ï¼šValgrindå’ŒASané˜²æ­¢å†…å­˜é”™è¯¯

### 9.2 å®é™…åº”ç”¨æŒ‡å¯¼


ğŸ“ˆ **é€‰æ‹©å·¥å…·çš„åŸåˆ™**ï¼š
- **å°é¡¹ç›®**ï¼šç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨+select/poll
- **ä¸­å‹é¡¹ç›®**ï¼šä½¿ç”¨libeventï¼Œå¼€å‘æ•ˆç‡é«˜
- **é«˜æ€§èƒ½é¡¹ç›®**ï¼šè€ƒè™‘libevï¼Œä½†éœ€è¦æ›´å¤šä¼˜åŒ–ç»éªŒ
- **ä¼ä¸šçº§é¡¹ç›®**ï¼šé€šå¸¸é€‰æ‹©æˆç†Ÿçš„æ¡†æ¶å¦‚Nginxã€Apache

ğŸ”§ **å¼€å‘ç¯å¢ƒå»ºè®®**ï¼š
- ä½¿ç”¨ç°ä»£çš„IDEï¼ˆVSCodeã€CLionï¼‰é…åˆè°ƒè¯•å·¥å…·
- å»ºç«‹å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒï¼ŒåŒ…æ‹¬æ€§èƒ½æµ‹è¯•
- é‡è§†å†…å­˜æ£€æµ‹ï¼Œåœ¨å¼€å‘é˜¶æ®µå°±å‘ç°é—®é¢˜

### 9.3 å­¦ä¹ è·¯å¾„å»ºè®®


ğŸ“š **å¾ªåºæ¸è¿›çš„å­¦ä¹ é¡ºåº**ï¼š
1. **åŸºç¡€**ï¼šå…ˆæŒæ¡åŸºæœ¬çš„socketç¼–ç¨‹
2. **å·¥å…·**ï¼šå­¦ä¼šä½¿ç”¨è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…·
3. **æ¡†æ¶**ï¼šæ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„äº‹ä»¶åº“
4. **ä¼˜åŒ–**ï¼šåœ¨æœ‰å®é™…é¡¹ç›®ç»éªŒåå†æ·±å…¥æ€§èƒ½ä¼˜åŒ–

ğŸš€ **è¿›é˜¶æ–¹å‘**ï¼š
- **é«˜å¹¶å‘**ï¼šå­¦ä¹ epollã€kqueueç­‰é«˜çº§IOæ¨¡å‹
- **åè®®å®ç°**ï¼šå®ç°HTTPã€WebSocketç­‰åº”ç”¨å±‚åè®®
- **åˆ†å¸ƒå¼**ï¼šå­¦ä¹ è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°ç­‰æŠ€æœ¯

**ğŸ’¡ æ ¸å¿ƒè®°å¿†**ï¼š
- ç³»ç»Ÿè°ƒç”¨æ˜¯åŸºç¡€ï¼Œåº“å‡½æ•°æ˜¯ä¾¿åˆ©
- äº‹ä»¶é©±åŠ¨è§£å†³é«˜å¹¶å‘ï¼Œé€‰å¯¹å·¥å…·äº‹åŠåŠŸå€
- å·¥å…·é“¾å®Œæ•´æ˜¯ä¸“ä¸šå¼€å‘çš„æ ‡å¿—
- è·¨å¹³å°éœ€è¦ç»†å¿ƒå¤„ç†å¹³å°å·®å¼‚