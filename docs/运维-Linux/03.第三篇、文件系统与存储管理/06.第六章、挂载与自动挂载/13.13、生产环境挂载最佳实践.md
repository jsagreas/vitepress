---
title: 13ã€ç”Ÿäº§ç¯å¢ƒæŒ‚è½½æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [ç”Ÿäº§ç¯å¢ƒæŒ‚è½½è§„èŒƒ](#1-ç”Ÿäº§ç¯å¢ƒæŒ‚è½½è§„èŒƒ)
2. [æŒ‚è½½ç‚¹å‘½åçº¦å®š](#2-æŒ‚è½½ç‚¹å‘½åçº¦å®š)
3. [è‡ªåŠ¨åŒ–æŒ‚è½½è„šæœ¬](#3-è‡ªåŠ¨åŒ–æŒ‚è½½è„šæœ¬)
4. [é…ç½®å¤‡ä»½ä¸æ¢å¤](#4-é…ç½®å¤‡ä»½ä¸æ¢å¤)
5. [å˜æ›´ç®¡ç†æµç¨‹](#5-å˜æ›´ç®¡ç†æµç¨‹)
6. [å®¹ç¾æŒ‚è½½ç­–ç•¥](#6-å®¹ç¾æŒ‚è½½ç­–ç•¥)
7. [æ€§èƒ½ä¼˜åŒ–æŠ€å·§](#7-æ€§èƒ½ä¼˜åŒ–æŠ€å·§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¢ ç”Ÿäº§ç¯å¢ƒæŒ‚è½½è§„èŒƒ


### 1.1 ä»€ä¹ˆæ˜¯ç”Ÿäº§ç¯å¢ƒæŒ‚è½½è§„èŒƒ


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
ç”Ÿäº§ç¯å¢ƒæŒ‚è½½è§„èŒƒå°±åƒ"å…¬å¸ç®¡ç†åˆ¶åº¦"ï¼š
- **æ ‡å‡†åŒ–**ï¼šæ‰€æœ‰æœåŠ¡å™¨éƒ½æŒ‰åŒæ ·çš„è§„åˆ™æ¥æŒ‚è½½å­˜å‚¨
- **å¯é¢„æµ‹**ï¼šä»»ä½•äººéƒ½èƒ½çŸ¥é“æ•°æ®å­˜æ”¾åœ¨å“ªé‡Œ
- **æ˜“ç»´æŠ¤**ï¼šå‡ºé—®é¢˜æ—¶èƒ½å¿«é€Ÿå®šä½å’Œä¿®å¤
- **é£é™©æ§åˆ¶**ï¼šé¿å…å› æŒ‚è½½é”™è¯¯å¯¼è‡´ç³»ç»Ÿæ•…éšœ

```
ç”Ÿäº§ç¯å¢ƒ vs ä¸ªäººç”µè„‘ï¼š
ä¸ªäººç”µè„‘æŒ‚è½½ï¼š        ç”Ÿäº§ç¯å¢ƒæŒ‚è½½ï¼š
éšæ„æŒ‚è½½ /mnt/disk1   æŒ‰è§„èŒƒæŒ‚è½½ /data/app1
å‡ºé”™é‡å¯å°±è¡Œ          å‡ºé”™å½±å“ä¸šåŠ¡è¿è¡Œ
é…ç½®æ··ä¹±æ— æ‰€è°“        é…ç½®å¿…é¡»æ ‡å‡†ç»Ÿä¸€
```

### 1.2 æ ¸å¿ƒè§„èŒƒåŸåˆ™


**ğŸ“‹ ç”Ÿäº§ç¯å¢ƒæŒ‚è½½åŸåˆ™**ï¼š

1ï¸âƒ£ **ä¸€è‡´æ€§åŸåˆ™**ï¼š
```bash
# æ‰€æœ‰æœåŠ¡å™¨ç»Ÿä¸€æŒ‚è½½ç»“æ„
/data/          # åº”ç”¨æ•°æ®ç›®å½•
/logs/          # æ—¥å¿—å­˜å‚¨ç›®å½•  
/backup/        # å¤‡ä»½å­˜å‚¨ç›®å½•
/shared/        # å…±äº«å­˜å‚¨ç›®å½•
```

2ï¸âƒ£ **å¯é æ€§åŸåˆ™**ï¼š
```bash
# fstabé…ç½®ç¤ºä¾‹ - ç”Ÿäº§ç¯å¢ƒæ ‡å‡†
/dev/sdb1 /data  ext4 defaults,noatime,errors=remount-ro 0 2
/dev/sdc1 /logs  ext4 defaults,noatime,errors=continue    0 2
/dev/sdd1 /backup ext4 defaults,noatime,noexec,nosuid    0 2
```

3ï¸âƒ£ **å®‰å…¨æ€§åŸåˆ™**ï¼š
```bash
# æƒé™æ§åˆ¶
chmod 755 /data/
chmod 750 /logs/
chmod 700 /backup/

# ç”¨æˆ·ç»„è®¾ç½®
chown root:appgroup /data/
chown root:loggroup /logs/
chown root:backup   /backup/
```

### 1.3 æ ‡å‡†åŒ–æŒ‚è½½ç»“æ„


**ğŸ—ï¸ æ¨èç›®å½•ç»“æ„**ï¼š
```
Linuxæ ¹ç›®å½•ç»“æ„ï¼š
/
â”œâ”€â”€ data/           # åº”ç”¨æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ app1/       # ç¬¬ä¸€ä¸ªåº”ç”¨æ•°æ®
â”‚   â”œâ”€â”€ app2/       # ç¬¬äºŒä¸ªåº”ç”¨æ•°æ®
â”‚   â””â”€â”€ shared/     # å…±äº«æ•°æ®
â”œâ”€â”€ logs/           # æ—¥å¿—æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ app1/       # åº”ç”¨1æ—¥å¿—
â”‚   â”œâ”€â”€ app2/       # åº”ç”¨2æ—¥å¿—
â”‚   â””â”€â”€ system/     # ç³»ç»Ÿæ—¥å¿—
â”œâ”€â”€ backup/         # å¤‡ä»½æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ daily/      # æ¯æ—¥å¤‡ä»½
â”‚   â”œâ”€â”€ weekly/     # æ¯å‘¨å¤‡ä»½
â”‚   â””â”€â”€ archive/    # å½’æ¡£å¤‡ä»½
â””â”€â”€ shared/         # NFSç­‰å…±äº«å­˜å‚¨
    â”œâ”€â”€ documents/  # å…±äº«æ–‡æ¡£
    â””â”€â”€ resources/  # å…±äº«èµ„æº
```

**ğŸ“Š æŒ‚è½½é…ç½®è§„èŒƒè¡¨**ï¼š

| **ç›®å½•** | **ç”¨é€”** | **æ–‡ä»¶ç³»ç»Ÿ** | **æŒ‚è½½é€‰é¡¹** | **å¤‡ä»½çº§åˆ«** |
|----------|----------|-------------|-------------|-------------|
| `/data` | åº”ç”¨æ•°æ® | `ext4/xfs` | `defaults,noatime` | ğŸ“ˆ é«˜ |
| `/logs` | æ—¥å¿—æ–‡ä»¶ | `ext4` | `defaults,noatime,nodev` | ğŸ“Š ä¸­ |
| `/backup` | å¤‡ä»½å­˜å‚¨ | `ext4/xfs` | `noexec,nosuid,nodev` | ğŸ“‰ ä½ |
| `/shared` | å…±äº«å­˜å‚¨ | `nfs/cifs` | `defaults,_netdev` | ğŸ“Š ä¸­ |

---

## 2. ğŸ“› æŒ‚è½½ç‚¹å‘½åçº¦å®š


### 2.1 å‘½åè§„èŒƒåŸåˆ™


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
æŒ‚è½½ç‚¹å‘½åå°±åƒ"é—¨ç‰Œå·è§„åˆ™"ï¼š
- **æ¸…æ™°æ˜äº†**ï¼šä¸€çœ‹å°±çŸ¥é“é‡Œé¢å­˜çš„æ˜¯ä»€ä¹ˆ
- **ç»Ÿä¸€æ ¼å¼**ï¼šæ‰€æœ‰æœåŠ¡å™¨éƒ½ç”¨ç›¸åŒçš„å‘½åæ–¹å¼
- **ä¾¿äºç®¡ç†**ï¼šç³»ç»Ÿç®¡ç†å‘˜èƒ½å¿«é€Ÿç†è§£å’Œæ“ä½œ

**ğŸ“ å‘½åè§„åˆ™è¯¦è§£**ï¼š

1ï¸âƒ£ **åŠŸèƒ½å¯¼å‘å‘½å**ï¼š
```bash
# æŒ‰åŠŸèƒ½åˆ†ç±»
/data/database/     # æ•°æ®åº“æ–‡ä»¶
/data/webroot/      # ç½‘ç«™æ ¹ç›®å½•
/data/upload/       # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
/logs/apache/       # Apacheæ—¥å¿—
/logs/mysql/        # MySQLæ—¥å¿—
```

2ï¸âƒ£ **åº”ç”¨å¯¼å‘å‘½å**ï¼š
```bash
# æŒ‰åº”ç”¨åˆ†ç±»
/data/crm/          # CRMç³»ç»Ÿæ•°æ®
/data/erp/          # ERPç³»ç»Ÿæ•°æ®  
/data/oa/           # OAç³»ç»Ÿæ•°æ®
/logs/crm/          # CRMç³»ç»Ÿæ—¥å¿—
/logs/erp/          # ERPç³»ç»Ÿæ—¥å¿—
```

### 2.2 ä¼ä¸šçº§å‘½åè§„èŒƒ


**ğŸ¢ å¤§å‹ä¼ä¸šå‘½åç¤ºä¾‹**ï¼š
```bash
# æ ¼å¼ï¼š/ç±»å‹/ç¯å¢ƒ/é¡¹ç›®/åŠŸèƒ½/
/data/prod/crm/database/        # ç”Ÿäº§ç¯å¢ƒCRMæ•°æ®åº“
/data/test/crm/database/        # æµ‹è¯•ç¯å¢ƒCRMæ•°æ®åº“
/logs/prod/crm/application/     # ç”Ÿäº§ç¯å¢ƒCRMåº”ç”¨æ—¥å¿—
/backup/prod/crm/daily/         # ç”Ÿäº§ç¯å¢ƒCRMæ¯æ—¥å¤‡ä»½

# ç£ç›˜æ ‡è¯†å‘½å
/data01/                        # ç¬¬ä¸€å—æ•°æ®ç›˜
/data02/                        # ç¬¬äºŒå—æ•°æ®ç›˜
/logs01/                        # ç¬¬ä¸€å—æ—¥å¿—ç›˜
/backup01/                      # ç¬¬ä¸€å—å¤‡ä»½ç›˜
```

**ğŸ“‹ å‘½åçº¦å®šæ–‡æ¡£ç¤ºä¾‹**ï¼š
```markdown
ä¼ä¸šæŒ‚è½½ç‚¹å‘½åè§„èŒƒ v1.2
=============================

ä¸€ã€åŸºç¡€è§„åˆ™
- å…¨å°å†™å­—æ¯
- ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼Œä¸ä½¿ç”¨è¿å­—ç¬¦
- è·¯å¾„ä¸è¶…è¿‡3çº§æ·±åº¦

äºŒã€ç¯å¢ƒæ ‡è¯†
- prod: ç”Ÿäº§ç¯å¢ƒ
- test: æµ‹è¯•ç¯å¢ƒ  
- dev:  å¼€å‘ç¯å¢ƒ
- uat:  ç”¨æˆ·éªŒæ”¶ç¯å¢ƒ

ä¸‰ã€åŠŸèƒ½æ ‡è¯†
- data:   åº”ç”¨æ•°æ®
- logs:   æ—¥å¿—æ–‡ä»¶
- backup: å¤‡ä»½æ–‡ä»¶
- cache:  ç¼“å­˜æ–‡ä»¶
- temp:   ä¸´æ—¶æ–‡ä»¶
```

### 2.3 é¿å…çš„å‘½åæ–¹å¼


**âŒ ä¸æ¨èçš„å‘½å**ï¼š
```bash
# æ¨¡ç³Šä¸æ¸…
/mnt/disk1/         # ä¸çŸ¥é“å­˜ä»€ä¹ˆ
/opt/stuff/         # å†…å®¹ä¸æ˜ç¡®
/tmp/important/     # é‡è¦æ–‡ä»¶ä¸åº”æ”¾åœ¨tmp

# å®¹æ˜“æ··æ·†  
/data1/ /data2/     # æ•°å­—ç¼–å·ä¸ç›´è§‚
/disk_a/ /disk_b/   # å­—æ¯æ ‡è¯†ä¸æ˜ç¡®
/mount1/ /mount2/   # é€šç”¨åç§°æ— æ„ä¹‰
```

**âœ… æ¨èçš„å‘½å**ï¼š
```bash
# æ¸…æ™°æ˜ç¡®
/data/crm_database/     # æ˜ç¡®æ˜¯CRMæ•°æ®åº“
/logs/web_server/       # æ˜ç¡®æ˜¯WebæœåŠ¡å™¨æ—¥å¿—
/backup/system_config/  # æ˜ç¡®æ˜¯ç³»ç»Ÿé…ç½®å¤‡ä»½

# ç»“æ„åŒ–å‘½å
/storage/ssd01/         # SSDå­˜å‚¨ç¬¬ä¸€å—
/storage/hdd01/         # HDDå­˜å‚¨ç¬¬ä¸€å—
/network/nfs_share/     # NFSå…±äº«å­˜å‚¨
```

---

## 3. ğŸ¤– è‡ªåŠ¨åŒ–æŒ‚è½½è„šæœ¬


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨åŒ–æŒ‚è½½


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
è‡ªåŠ¨åŒ–æŒ‚è½½è„šæœ¬å°±åƒ"æ™ºèƒ½ç®¡å®¶"ï¼š
- **å‡å°‘äººå·¥é”™è¯¯**ï¼šé¿å…æ‰‹å·¥æ“ä½œå‡ºé”™
- **æé«˜æ•ˆç‡**ï¼šå‡ åˆ†é’Ÿå®ŒæˆåŸæœ¬éœ€è¦å‡ å°æ—¶çš„å·¥ä½œ
- **ç¡®ä¿ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æœåŠ¡å™¨éƒ½ç”¨ç›¸åŒçš„é…ç½®
- **æ”¯æŒæ‰¹é‡æ“ä½œ**ï¼šåŒæ—¶é…ç½®å¤šå°æœåŠ¡å™¨

```
æ‰‹å·¥æŒ‚è½½ vs è‡ªåŠ¨åŒ–æŒ‚è½½ï¼š
æ‰‹å·¥æ“ä½œï¼š                è‡ªåŠ¨åŒ–è„šæœ¬ï¼š
1. é€å°æœåŠ¡å™¨ç™»å½•          1. ä¸€é”®æ‰¹é‡æ‰§è¡Œ
2. æ‰‹åŠ¨ç¼–è¾‘fstab          2. è‡ªåŠ¨ç”Ÿæˆé…ç½®
3. æ‰‹åŠ¨åˆ›å»ºç›®å½•           3. è‡ªåŠ¨åˆ›å»ºç»“æ„
4. æ‰‹åŠ¨è®¾ç½®æƒé™           4. è‡ªåŠ¨åº”ç”¨æƒé™
5. å®¹æ˜“å‡ºé”™               5. æ ‡å‡†åŒ–æ‰§è¡Œ
```

### 3.2 åŸºç¡€æŒ‚è½½è„šæœ¬


**ğŸ”§ ç®€å•æŒ‚è½½è„šæœ¬**ï¼š
```bash
#!/bin/bash
# auto_mount.sh - è‡ªåŠ¨æŒ‚è½½è„šæœ¬

# è„šæœ¬é…ç½®æ®µ
SCRIPT_NAME="Auto Mount Script"
VERSION="1.0"
LOG_FILE="/var/log/auto_mount.log"

# æ—¥å¿—è®°å½•å‡½æ•°
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a $LOG_FILE
}

# æ£€æŸ¥ç£ç›˜æ˜¯å¦å­˜åœ¨
check_disk() {
    local device=$1
    if [ ! -b "$device" ]; then
        log_message "ERROR: Device $device not found"
        return 1
    fi
    log_message "INFO: Device $device found"
    return 0
}

# åˆ›å»ºæŒ‚è½½ç‚¹
create_mount_point() {
    local mount_point=$1
    if [ ! -d "$mount_point" ]; then
        mkdir -p "$mount_point"
        log_message "INFO: Created mount point $mount_point"
    else
        log_message "INFO: Mount point $mount_point already exists"
    fi
}

# æ‰§è¡ŒæŒ‚è½½
do_mount() {
    local device=$1
    local mount_point=$2
    local fs_type=$3
    local options=$4
    
    # æ£€æŸ¥æ˜¯å¦å·²ç»æŒ‚è½½
    if mountpoint -q "$mount_point"; then
        log_message "WARNING: $mount_point already mounted"
        return 0
    fi
    
    # æ‰§è¡ŒæŒ‚è½½
    mount -t $fs_type -o $options $device $mount_point
    if [ $? -eq 0 ]; then
        log_message "SUCCESS: Mounted $device to $mount_point"
        return 0
    else
        log_message "ERROR: Failed to mount $device to $mount_point"
        return 1
    fi
}

# ä¸»å‡½æ•°
main() {
    log_message "Starting $SCRIPT_NAME v$VERSION"
    
    # æŒ‚è½½é…ç½®æ•°ç»„
    # æ ¼å¼ï¼šè®¾å¤‡:æŒ‚è½½ç‚¹:æ–‡ä»¶ç³»ç»Ÿ:é€‰é¡¹
    MOUNT_CONFIG=(
        "/dev/sdb1:/data/app1:ext4:defaults,noatime"
        "/dev/sdc1:/logs/app1:ext4:defaults,noatime,nodev"
        "/dev/sdd1:/backup:ext4:defaults,noatime,noexec"
    )
    
    # éå†é…ç½®è¿›è¡ŒæŒ‚è½½
    for config in "${MOUNT_CONFIG[@]}"; do
        IFS=':' read -r device mount_point fs_type options <<< "$config"
        
        log_message "Processing: $device -> $mount_point"
        
        # æ£€æŸ¥è®¾å¤‡
        if ! check_disk "$device"; then
            continue
        fi
        
        # åˆ›å»ºæŒ‚è½½ç‚¹
        create_mount_point "$mount_point"
        
        # æ‰§è¡ŒæŒ‚è½½
        do_mount "$device" "$mount_point" "$fs_type" "$options"
    done
    
    log_message "Mount script completed"
}

# è¿è¡Œä¸»å‡½æ•°
main "$@"
```

### 3.3 ä¼ä¸šçº§æŒ‚è½½è„šæœ¬


**ğŸ¢ é«˜çº§æŒ‚è½½è„šæœ¬**ï¼š
```bash
#!/bin/bash
# enterprise_mount.sh - ä¼ä¸šçº§æŒ‚è½½ç®¡ç†è„šæœ¬

# å…¨å±€é…ç½®
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly CONFIG_FILE="$SCRIPT_DIR/mount_config.conf"
readonly LOG_DIR="/var/log/mount_manager"
readonly BACKUP_DIR="/etc/mount_backup"

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p "$LOG_DIR" "$BACKUP_DIR"

# è¯»å–é…ç½®æ–‡ä»¶
source_config() {
    if [[ -f "$CONFIG_FILE" ]]; then
        source "$CONFIG_FILE"
        log_info "Configuration loaded from $CONFIG_FILE"
    else
        log_error "Configuration file not found: $CONFIG_FILE"
        exit 1
    fi
}

# å¤‡ä»½å½“å‰fstab
backup_fstab() {
    local backup_file="$BACKUP_DIR/fstab.$(date +%Y%m%d_%H%M%S).bak"
    cp /etc/fstab "$backup_file"
    log_info "fstab backed up to $backup_file"
}

# éªŒè¯æŒ‚è½½é…ç½®
validate_mount_config() {
    local device=$1
    local mount_point=$2
    local fs_type=$3
    
    # æ£€æŸ¥è®¾å¤‡æ˜¯å¦å­˜åœ¨
    if [[ ! -b "$device" ]]; then
        log_error "Block device not found: $device"
        return 1
    fi
    
    # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿç±»å‹
    if ! grep -q "$fs_type" /proc/filesystems; then
        log_error "Filesystem type not supported: $fs_type"
        return 1
    fi
    
    # æ£€æŸ¥æŒ‚è½½ç‚¹è·¯å¾„åˆæ³•æ€§
    if [[ ! "$mount_point" =~ ^/[a-zA-Z0-9/_-]+$ ]]; then
        log_error "Invalid mount point path: $mount_point"
        return 1
    fi
    
    return 0
}

# å®‰å…¨æŒ‚è½½å‡½æ•°
safe_mount() {
    local device=$1
    local mount_point=$2
    local fs_type=$3
    local options=$4
    
    # éªŒè¯é…ç½®
    if ! validate_mount_config "$device" "$mount_point" "$fs_type"; then
        return 1
    fi
    
    # æ£€æŸ¥ç°æœ‰æŒ‚è½½
    if mountpoint -q "$mount_point"; then
        log_warn "Mount point already in use: $mount_point"
        return 0
    fi
    
    # åˆ›å»ºæŒ‚è½½ç‚¹
    mkdir -p "$mount_point"
    
    # æµ‹è¯•æŒ‚è½½ï¼ˆä¸´æ—¶ï¼‰
    if mount -t "$fs_type" -o "$options" "$device" "$mount_point"; then
        log_info "Test mount successful: $device -> $mount_point"
        umount "$mount_point"
    else
        log_error "Test mount failed: $device -> $mount_point"
        return 1
    fi
    
    # æ·»åŠ åˆ°fstab
    echo "$device $mount_point $fs_type $options 0 2" >> /etc/fstab
    
    # é‡æ–°æŒ‚è½½æ‰€æœ‰fstabæ¡ç›®
    mount -a
    
    log_info "Mount completed: $device -> $mount_point"
}

# é…ç½®æ–‡ä»¶ç¤ºä¾‹ (mount_config.conf)
cat > "$CONFIG_FILE" << 'EOF'
# æŒ‚è½½é…ç½®æ–‡ä»¶
# æ ¼å¼: MOUNT_CONFIGS[n]="device:mount_point:fs_type:options:permissions"

MOUNT_CONFIGS[0]="/dev/sdb1:/data/mysql:ext4:defaults,noatime:mysql:mysql:750"
MOUNT_CONFIGS[1]="/dev/sdc1:/logs/application:ext4:defaults,noatime,nodev:root:adm:755"  
MOUNT_CONFIGS[2]="/dev/sdd1:/backup/system:ext4:defaults,noexec,nosuid:root:backup:700"
EOF
```

---

## 4. ğŸ’¾ é…ç½®å¤‡ä»½ä¸æ¢å¤


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®å¤‡ä»½


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
é…ç½®å¤‡ä»½å°±åƒ"ä¿é™©å•"ï¼š
- **é˜²æ­¢æ„å¤–**ï¼šè¯¯æ“ä½œå¯¼è‡´ç³»ç»Ÿæ— æ³•å¯åŠ¨
- **å¿«é€Ÿæ¢å¤**ï¼šå‡ºé—®é¢˜æ—¶èƒ½ç«‹å³å›åˆ°æ­£å¸¸çŠ¶æ€
- **å˜æ›´è¿½è¸ª**ï¼šè®°å½•æ¯æ¬¡ä¿®æ”¹çš„å†å²
- **å®¡è®¡éœ€æ±‚**ï¼šæ»¡è¶³ä¼ä¸šåˆè§„è¦æ±‚

```
æ²¡æœ‰å¤‡ä»½çš„é£é™©ï¼š
ä¿®æ”¹fstabé…ç½® â†’ é‡å¯æœåŠ¡å™¨ â†’ ç³»ç»Ÿæ— æ³•å¯åŠ¨
                â†“
           ç´§æ€¥ç»´æŠ¤æ¨¡å¼ â†’ æ‰‹å·¥ä¿®å¤ â†’ ä¸šåŠ¡ä¸­æ–­æ•°å°æ—¶

æœ‰å¤‡ä»½çš„æµç¨‹ï¼š
ä¿®æ”¹fstabé…ç½® â†’ é‡å¯å¤±è´¥ â†’ å¯åŠ¨æ•‘æ´æ¨¡å¼
                â†“
           æ¢å¤å¤‡ä»½é…ç½® â†’ é‡æ–°å¯åŠ¨ â†’ 5åˆ†é’Ÿæ¢å¤
```

### 4.2 è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬


**ğŸ”„ é…ç½®å¤‡ä»½è„šæœ¬**ï¼š
```bash
#!/bin/bash
# mount_backup.sh - æŒ‚è½½é…ç½®å¤‡ä»½è„šæœ¬

readonly BACKUP_BASE="/etc/mount_backup"
readonly RETENTION_DAYS=30
readonly LOG_FILE="/var/log/mount_backup.log"

# æ—¥å¿—å‡½æ•°
log_with_timestamp() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# åˆ›å»ºå¤‡ä»½ç›®å½•ç»“æ„
setup_backup_dirs() {
    local date_dir="$BACKUP_BASE/$(date +%Y/%m/%d)"
    mkdir -p "$date_dir"
    echo "$date_dir"
}

# å¤‡ä»½å…³é”®é…ç½®æ–‡ä»¶
backup_mount_configs() {
    local backup_dir=$1
    local timestamp=$(date +%H%M%S)
    
    # å¤‡ä»½fstab
    if [[ -f /etc/fstab ]]; then
        cp /etc/fstab "$backup_dir/fstab_$timestamp"
        log_with_timestamp "Backed up /etc/fstab"
    fi
    
    # å¤‡ä»½å½“å‰æŒ‚è½½çŠ¶æ€
    mount > "$backup_dir/mount_status_$timestamp"
    df -h > "$backup_dir/disk_usage_$timestamp"
    lsblk > "$backup_dir/block_devices_$timestamp"
    
    # å¤‡ä»½ç³»ç»Ÿä¿¡æ¯
    uname -a > "$backup_dir/system_info_$timestamp"
    cat /proc/version > "$backup_dir/kernel_info_$timestamp"
    
    log_with_timestamp "Mount configuration backed up to $backup_dir"
}

# åˆ›å»ºå¤‡ä»½æ¸…å•
create_backup_manifest() {
    local backup_dir=$1
    local manifest="$backup_dir/MANIFEST"
    
    {
        echo "Backup created: $(date)"
        echo "Hostname: $(hostname)"
        echo "System: $(uname -sr)"
        echo "Files in backup:"
        ls -la "$backup_dir"
    } > "$manifest"
}

# æ¸…ç†è¿‡æœŸå¤‡ä»½
cleanup_old_backups() {
    log_with_timestamp "Starting cleanup of backups older than $RETENTION_DAYS days"
    
    find "$BACKUP_BASE" -type f -mtime +$RETENTION_DAYS -delete
    find "$BACKUP_BASE" -type d -empty -delete
    
    log_with_timestamp "Cleanup completed"
}

# ä¸»å¤‡ä»½æµç¨‹
main() {
    log_with_timestamp "Starting mount configuration backup"
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    local backup_dir
    backup_dir=$(setup_backup_dirs)
    
    # æ‰§è¡Œå¤‡ä»½
    backup_mount_configs "$backup_dir"
    
    # åˆ›å»ºæ¸…å•
    create_backup_manifest "$backup_dir"
    
    # æ¸…ç†è¿‡æœŸæ–‡ä»¶
    cleanup_old_backups
    
    log_with_timestamp "Backup process completed successfully"
}

main "$@"
```

### 4.3 ç¾éš¾æ¢å¤è„šæœ¬


**ğŸš¨ ç´§æ€¥æ¢å¤è„šæœ¬**ï¼š
```bash
#!/bin/bash
# mount_recovery.sh - æŒ‚è½½é…ç½®æ¢å¤è„šæœ¬

readonly BACKUP_BASE="/etc/mount_backup"
readonly RECOVERY_LOG="/var/log/mount_recovery.log"

# å®‰å…¨ç¡®è®¤å‡½æ•°
confirm_recovery() {
    local backup_file=$1
    
    echo "========================================"
    echo "MOUNT CONFIGURATION RECOVERY"
    echo "========================================"
    echo "Current time: $(date)"
    echo "Backup file: $backup_file"
    echo "Current fstab will be replaced!"
    echo
    read -p "Are you sure you want to proceed? (yes/no): " confirm
    
    if [[ "$confirm" != "yes" ]]; then
        echo "Recovery cancelled by user"
        exit 0
    fi
}

# é€‰æ‹©æ¢å¤ç‚¹
select_recovery_point() {
    echo "Available backup dates:"
    find "$BACKUP_BASE" -name "fstab_*" | head -10 | while read -r backup; do
        local date=$(stat -c %y "$backup" | cut -d' ' -f1)
        local time=$(basename "$backup" | sed 's/fstab_//')
        echo "  $backup ($date $time)"
    done
    
    echo
    read -p "Enter full path to backup file: " backup_path
    
    if [[ ! -f "$backup_path" ]]; then
        echo "Error: Backup file not found: $backup_path"
        exit 1
    fi
    
    echo "$backup_path"
}

# æ‰§è¡Œæ¢å¤
perform_recovery() {
    local backup_file=$1
    
    # å¤‡ä»½å½“å‰é…ç½®ï¼ˆä»¥é˜²æ¢å¤å¤±è´¥ï¼‰
    cp /etc/fstab "/etc/fstab.pre-recovery.$(date +%s)"
    
    # æ¢å¤é…ç½®
    cp "$backup_file" /etc/fstab
    
    # éªŒè¯fstabè¯­æ³•
    if ! mount -fav; then
        echo "Error: fstab syntax error detected!"
        echo "Rolling back..."
        cp "/etc/fstab.pre-recovery.*" /etc/fstab
        exit 1
    fi
    
    echo "Configuration restored successfully"
    echo "Please review /etc/fstab before rebooting"
}

# ä¸»æ¢å¤æµç¨‹
main() {
    echo "Mount Configuration Recovery Tool"
    echo "================================="
    
    # æ£€æŸ¥æƒé™
    if [[ $EUID -ne 0 ]]; then
        echo "Error: This script must be run as root"
        exit 1
    fi
    
    # é€‰æ‹©æ¢å¤ç‚¹
    local backup_file
    backup_file=$(select_recovery_point)
    
    # ç¡®è®¤æ¢å¤æ“ä½œ
    confirm_recovery "$backup_file"
    
    # æ‰§è¡Œæ¢å¤
    perform_recovery "$backup_file"
}

main "$@"
```

---

## 5. ğŸ”„ å˜æ›´ç®¡ç†æµç¨‹


### 5.1 ä»€ä¹ˆæ˜¯å˜æ›´ç®¡ç†æµç¨‹


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
å˜æ›´ç®¡ç†æµç¨‹å°±åƒ"åŒ»é™¢æ‰‹æœ¯æµç¨‹"ï¼š
- **æœ¯å‰å‡†å¤‡**ï¼šè¯¦ç»†è®¡åˆ’ï¼Œå‡†å¤‡å„ç§é¢„æ¡ˆ
- **å¤šäººç¡®è®¤**ï¼šä¸æ˜¯ä¸€ä¸ªäººè¯´äº†ç®—ï¼Œéœ€è¦å›¢é˜Ÿå®¡æ ¸
- **è®°å½•è¿½è¸ª**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½è¦è®°å½•ï¼Œå‡ºé—®é¢˜èƒ½è¿½æº¯
- **æœ¯åè§‚å¯Ÿ**ï¼šä¿®æ”¹åè¦ç›‘æ§ï¼Œç¡®ä¿æ²¡æœ‰å‰¯ä½œç”¨

```
æ— æµç¨‹çš„å˜æ›´ï¼š                æœ‰æµç¨‹çš„å˜æ›´ï¼š
æƒ³åˆ°å°±æ”¹ â†’ ç›´æ¥æ“ä½œ           è®¡åˆ’ â†’ å®¡æ ¸ â†’ æ‰¹å‡† â†’ æ‰§è¡Œ
   â†“                          â†“
 å‡ºé—®é¢˜æ‰å‘ç°                 é¢„é˜²é—®é¢˜å‘ç”Ÿ
```

### 5.2 æŒ‚è½½å˜æ›´æ ‡å‡†æµç¨‹


**ğŸ“‹ å˜æ›´ç®¡ç†æ£€æŸ¥æ¸…å•**ï¼š

**ğŸ”¢ å˜æ›´å‰å‡†å¤‡é˜¶æ®µ**ï¼š
```bash
â–¡ å˜æ›´åŸå› å’Œç›®æ ‡æ˜ç¡®
â–¡ å½±å“èŒƒå›´è¯„ä¼°å®Œæˆ
â–¡ å›æ»šæ–¹æ¡ˆå‡†å¤‡å°±ç»ª
â–¡ å¤‡ä»½éªŒè¯å®Œæˆ
â–¡ å˜æ›´çª—å£ç¡®è®¤
â–¡ ç›¸å…³å›¢é˜Ÿé€šçŸ¥
â–¡ åº”æ€¥è”ç³»äººç¡®å®š
```

**ğŸ“ å˜æ›´ç”³è¯·æ¨¡æ¿**ï¼š
```markdown
æŒ‚è½½å˜æ›´ç”³è¯·å•
================

åŸºæœ¬ä¿¡æ¯ï¼š
- ç”³è¯·äººï¼šå¼ ä¸‰
- ç”³è¯·æ—¶é—´ï¼š2024-12-15 10:00
- å˜æ›´ç±»å‹ï¼šæ–°å¢æŒ‚è½½ç‚¹
- ç´§æ€¥ç¨‹åº¦ï¼šæ™®é€š

å˜æ›´è¯¦æƒ…ï¼š
- æœåŠ¡å™¨ï¼šweb01.company.com
- æ–°å¢æŒ‚è½½ï¼š/dev/sde1 -> /data/cache
- æ–‡ä»¶ç³»ç»Ÿï¼šext4
- æŒ‚è½½é€‰é¡¹ï¼šdefaults,noatime,nodev

é£é™©è¯„ä¼°ï¼š
- ä¸šåŠ¡å½±å“ï¼šæ— ï¼ˆæ–°å¢æŒ‚è½½ï¼‰
- é£é™©ç­‰çº§ï¼šä½
- å›æ»šæ–¹æ¡ˆï¼šåˆ é™¤fstabæ¡ç›®ï¼Œå¸è½½æŒ‚è½½ç‚¹

æµ‹è¯•è®¡åˆ’ï¼š
1. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
2. ç”Ÿäº§ç¯å¢ƒå°èŒƒå›´æµ‹è¯•
3. ç›‘æ§ç³»ç»ŸçŠ¶æ€30åˆ†é’Ÿ
```

### 5.3 å˜æ›´æ‰§è¡Œè„šæœ¬


**ğŸ”§ æ ‡å‡†å˜æ›´æ‰§è¡Œè„šæœ¬**ï¼š
```bash
#!/bin/bash
# change_execution.sh - å˜æ›´æ‰§è¡Œè„šæœ¬

readonly CHANGE_ID="CHG-$(date +%Y%m%d-%H%M%S)"
readonly LOG_FILE="/var/log/mount_changes/$CHANGE_ID.log"
readonly CHECKPOINT_DIR="/tmp/mount_checkpoint_$CHANGE_ID"

# åˆ›å»ºå˜æ›´æ—¥å¿—
setup_change_logging() {
    mkdir -p "$(dirname "$LOG_FILE")" "$CHECKPOINT_DIR"
    exec 1> >(tee -a "$LOG_FILE")
    exec 2> >(tee -a "$LOG_FILE")
}

# å˜æ›´å‰æ£€æŸ¥ç‚¹
create_checkpoint() {
    echo "=== Creating Change Checkpoint ==="
    
    # ä¿å­˜å½“å‰çŠ¶æ€
    cp /etc/fstab "$CHECKPOINT_DIR/fstab.before"
    mount > "$CHECKPOINT_DIR/mount.before"
    df -h > "$CHECKPOINT_DIR/df.before"
    lsblk > "$CHECKPOINT_DIR/lsblk.before"
    
    # è®°å½•ç³»ç»Ÿè´Ÿè½½
    uptime > "$CHECKPOINT_DIR/uptime.before"
    free -m > "$CHECKPOINT_DIR/memory.before"
    
    echo "Checkpoint created at: $CHECKPOINT_DIR"
}

# æ‰§è¡Œå˜æ›´
execute_change() {
    local device=$1
    local mount_point=$2
    local fs_type=$3
    local options=$4
    
    echo "=== Executing Change ==="
    echo "Device: $device"
    echo "Mount Point: $mount_point"
    echo "Filesystem: $fs_type"
    echo "Options: $options"
    
    # åˆ›å»ºæŒ‚è½½ç‚¹
    mkdir -p "$mount_point"
    
    # æµ‹è¯•æŒ‚è½½
    if mount -t "$fs_type" -o "$options" "$device" "$mount_point"; then
        echo "Test mount successful"
        umount "$mount_point"
    else
        echo "Test mount failed, aborting change"
        return 1
    fi
    
    # æ·»åŠ åˆ°fstab
    echo "$device $mount_point $fs_type $options 0 2" >> /etc/fstab
    
    # æ°¸ä¹…æŒ‚è½½
    mount -a
    
    if mountpoint -q "$mount_point"; then
        echo "Change executed successfully"
        return 0
    else
        echo "Change execution failed"
        return 1
    fi
}

# å˜æ›´åéªŒè¯
post_change_verification() {
    echo "=== Post-Change Verification ==="
    
    # ä¿å­˜å˜æ›´åçŠ¶æ€
    mount > "$CHECKPOINT_DIR/mount.after"
    df -h > "$CHECKPOINT_DIR/df.after"
    lsblk > "$CHECKPOINT_DIR/lsblk.after"
    
    # å¯¹æ¯”å˜æ›´å‰å
    echo "Mount changes:"
    diff "$CHECKPOINT_DIR/mount.before" "$CHECKPOINT_DIR/mount.after"
    
    echo "Disk usage changes:"
    diff "$CHECKPOINT_DIR/df.before" "$CHECKPOINT_DIR/df.after"
    
    # åŸºæœ¬åŠŸèƒ½æµ‹è¯•
    local test_file="$2/mount_test_$$"
    if touch "$test_file" && rm "$test_file"; then
        echo "Mount point read-write test: PASSED"
    else
        echo "Mount point read-write test: FAILED"
        return 1
    fi
}

# ä¸»æ‰§è¡Œæµç¨‹
main() {
    local device=$1
    local mount_point=$2
    local fs_type=$3
    local options=$4
    
    echo "Starting change execution: $CHANGE_ID"
    
    # è®¾ç½®æ—¥å¿—
    setup_change_logging
    
    # åˆ›å»ºæ£€æŸ¥ç‚¹
    create_checkpoint
    
    # æ‰§è¡Œå˜æ›´
    if execute_change "$device" "$mount_point" "$fs_type" "$options"; then
        # å˜æ›´åéªŒè¯
        if post_change_verification "$mount_point"; then
            echo "Change completed successfully: $CHANGE_ID"
            exit 0
        else
            echo "Post-change verification failed"
            exit 1
        fi
    else
        echo "Change execution failed"
        exit 1
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
# ./change_execution.sh /dev/sde1 /data/cache ext4 defaults,noatime
main "$@"
```

---

## 6. ğŸ¥ å®¹ç¾æŒ‚è½½ç­–ç•¥


### 6.1 ä»€ä¹ˆæ˜¯å®¹ç¾æŒ‚è½½ç­–ç•¥


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
å®¹ç¾æŒ‚è½½ç­–ç•¥å°±åƒ"åº”æ€¥é¢„æ¡ˆ"ï¼š
- **å¤šé‡ä¿éšœ**ï¼šä¸æŠŠé¸¡è›‹æ”¾åœ¨ä¸€ä¸ªç¯®å­é‡Œ
- **å¿«é€Ÿåˆ‡æ¢**ï¼šä¸»ç³»ç»Ÿåäº†ï¼Œå¤‡ç”¨ç³»ç»Ÿç«‹å³æ¥ç®¡
- **æ•°æ®ä¿æŠ¤**ï¼šç¡®ä¿é‡è¦æ•°æ®ä¸ä¼šä¸¢å¤±
- **ä¸šåŠ¡è¿ç»­**ï¼šå°½é‡å‡å°‘æœåŠ¡ä¸­æ–­æ—¶é—´

```
å®¹ç¾åœºæ™¯ç¤ºä¾‹ï¼š
æ­£å¸¸æƒ…å†µï¼š              ç¾éš¾æƒ…å†µï¼š
ä¸»å­˜å‚¨ â†’ åº”ç”¨æœåŠ¡        ä¸»å­˜å‚¨æ•…éšœ â†’ åˆ‡æ¢å¤‡å­˜å‚¨
  â†“                       â†“
ç”¨æˆ·è®¿é—®æ­£å¸¸           ç”¨æˆ·æ„Ÿå—ä¸åˆ°ä¸­æ–­
```

### 6.2 å­˜å‚¨å®¹ç¾æ¶æ„


**ğŸ—ï¸ å®¹ç¾å­˜å‚¨æ¶æ„**ï¼š
```
å¤šå±‚æ¬¡å­˜å‚¨å®¹ç¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨å±‚                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¸»å­˜å‚¨    â”‚  å¤‡å­˜å‚¨   â”‚  è¿œç¨‹å¤‡ä»½  â”‚
â”‚   /data01   â”‚ /data02   â”‚ /backup    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœ¬åœ°RAID  â”‚ ç½‘ç»œå­˜å‚¨  â”‚  äº‘å­˜å‚¨    â”‚
â”‚   (ä¸»)      â”‚ (å¤‡)      â”‚ (å¼‚åœ°)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è‡ªåŠ¨æ•…éšœåˆ‡æ¢ï¼š
ä¸»å­˜å‚¨å¥åº·æ£€æŸ¥ â†’ æ•…éšœæ£€æµ‹ â†’ è‡ªåŠ¨åˆ‡æ¢å¤‡å­˜å‚¨
```

**ğŸ“Š å®¹ç¾çº§åˆ«å¯¹æ¯”**ï¼š

| **å®¹ç¾çº§åˆ«** | **æ¢å¤æ—¶é—´** | **æ•°æ®ä¸¢å¤±** | **æˆæœ¬** | **å¤æ‚åº¦** |
|-------------|-------------|-------------|---------|-----------|
| **åŸºç¡€å¤‡ä»½** | æ•°å°æ—¶ ğŸ• | å¯èƒ½ä¸¢å¤± âŒ | ä½ ğŸ’° | ç®€å• ğŸ“‰ |
| **çƒ­å¤‡ä»½** | å‡ åˆ†é’Ÿ â° | æå°‘ä¸¢å¤± âš ï¸ | ä¸­ ğŸ’°ğŸ’° | ä¸­ç­‰ ğŸ“Š |
| **å®æ—¶åŒæ­¥** | å‡ ç§’é’Ÿ âš¡ | æ— ä¸¢å¤± âœ… | é«˜ ğŸ’°ğŸ’°ğŸ’° | å¤æ‚ ğŸ“ˆ |
| **åŒæ´»ç³»ç»Ÿ** | æ— ä¸­æ–­ ğŸš€ | æ— ä¸¢å¤± âœ… | å¾ˆé«˜ ğŸ’°ğŸ’°ğŸ’°ğŸ’° | å¾ˆå¤æ‚ ğŸ“ˆğŸ“ˆ |

### 6.3 å®¹ç¾æŒ‚è½½é…ç½®


**ğŸ”§ ä¸»å¤‡å­˜å‚¨é…ç½®**ï¼š
```bash
#!/bin/bash
# disaster_recovery_mount.sh - å®¹ç¾æŒ‚è½½è„šæœ¬

readonly PRIMARY_STORAGE="/dev/sdb1"
readonly BACKUP_STORAGE="/dev/sdc1"
readonly MOUNT_POINT="/data/critical"
readonly CHECK_INTERVAL=30

# å­˜å‚¨å¥åº·æ£€æŸ¥
check_storage_health() {
    local device=$1
    
    # æ£€æŸ¥è®¾å¤‡æ˜¯å¦å­˜åœ¨
    if [[ ! -b "$device" ]]; then
        return 1
    fi
    
    # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ
    if ! fsck -n "$device" >/dev/null 2>&1; then
        return 1
    fi
    
    # æ£€æŸ¥ç£ç›˜I/O
    if ! timeout 5 dd if="$device" of=/dev/null bs=1M count=1 >/dev/null 2>&1; then
        return 1
    fi
    
    return 0
}

# åˆ‡æ¢åˆ°å¤‡ç”¨å­˜å‚¨
failover_to_backup() {
    echo "$(date): Failing over to backup storage"
    
    # å¸è½½ä¸»å­˜å‚¨
    if mountpoint -q "$MOUNT_POINT"; then
        umount "$MOUNT_POINT" || umount -l "$MOUNT_POINT"
    fi
    
    # æŒ‚è½½å¤‡ç”¨å­˜å‚¨
    mount "$BACKUP_STORAGE" "$MOUNT_POINT"
    
    if mountpoint -q "$MOUNT_POINT"; then
        echo "$(date): Failover successful"
        # é€šçŸ¥ç›‘æ§ç³»ç»Ÿ
        echo "FAILOVER: Switched to backup storage" | mail -s "Storage Failover" admin@company.com
        return 0
    else
        echo "$(date): Failover failed"
        return 1
    fi
}

# å®¹ç¾ç›‘æ§ä¸»å¾ªç¯
disaster_recovery_monitor() {
    while true; do
        # æ£€æŸ¥ä¸»å­˜å‚¨å¥åº·çŠ¶æ€
        if check_storage_health "$PRIMARY_STORAGE"; then
            # æ£€æŸ¥å½“å‰æŒ‚è½½æ˜¯å¦ä¸ºä¸»å­˜å‚¨
            current_device=$(findmnt -n -o SOURCE "$MOUNT_POINT")
            if [[ "$current_device" != "$PRIMARY_STORAGE" ]]; then
                # æ¢å¤åˆ°ä¸»å­˜å‚¨
                echo "$(date): Failing back to primary storage"
                umount "$MOUNT_POINT"
                mount "$PRIMARY_STORAGE" "$MOUNT_POINT"
            fi
        else
            # ä¸»å­˜å‚¨æœ‰é—®é¢˜ï¼Œæ£€æŸ¥å½“å‰æŒ‚è½½
            current_device=$(findmnt -n -o SOURCE "$MOUNT_POINT")
            if [[ "$current_device" == "$PRIMARY_STORAGE" ]]; then
                # éœ€è¦åˆ‡æ¢åˆ°å¤‡ç”¨å­˜å‚¨
                failover_to_backup
            fi
        fi
        
        sleep $CHECK_INTERVAL
    done
}

# fstabé…ç½®ç¤ºä¾‹
configure_fstab_for_dr() {
    cat >> /etc/fstab << EOF
# å®¹ç¾å­˜å‚¨é…ç½®
$PRIMARY_STORAGE $MOUNT_POINT ext4 defaults,noatime,nofail 0 2
# å¤‡ç”¨å­˜å‚¨ï¼ˆæ³¨é‡ŠçŠ¶æ€ï¼Œæ•…éšœæ—¶æ‰‹åŠ¨å¯ç”¨ï¼‰  
# $BACKUP_STORAGE $MOUNT_POINT ext4 defaults,noatime,nofail 0 2
EOF
}

# å¯åŠ¨å®¹ç¾ç›‘æ§
main() {
    echo "Starting disaster recovery monitoring for storage"
    disaster_recovery_monitor
}

# å¦‚æœç›´æ¥è¿è¡Œè„šæœ¬
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
```

---

## 7. âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§


### 7.1 æŒ‚è½½æ€§èƒ½å½±å“å› ç´ 


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
æŒ‚è½½æ€§èƒ½ä¼˜åŒ–å°±åƒ"æ±½è½¦è°ƒä¼˜"ï¼š
- **å¼•æ“è°ƒæ ¡**ï¼šæ–‡ä»¶ç³»ç»Ÿå‚æ•°ä¼˜åŒ–
- **é“è·¯é€‰æ‹©**ï¼šI/Oè°ƒåº¦ç®—æ³•é€‰æ‹©
- **é©¾é©¶ä¹ æƒ¯**ï¼šåº”ç”¨è®¿é—®æ¨¡å¼ä¼˜åŒ–
- **ä¿å…»ç»´æŠ¤**ï¼šå®šæœŸæ€§èƒ½ç›‘æ§å’Œè°ƒæ•´

```
æ€§èƒ½ä¼˜åŒ–å±‚æ¬¡ï¼š
ç¡¬ä»¶å±‚ï¼šSSD vs HDDï¼ŒRAIDé…ç½®
  â†“
ç³»ç»Ÿå±‚ï¼šæ–‡ä»¶ç³»ç»Ÿé€‰æ‹©ï¼ŒæŒ‚è½½å‚æ•°
  â†“  
åº”ç”¨å±‚ï¼šè®¿é—®æ¨¡å¼ï¼Œç¼“å­˜ç­–ç•¥
```

### 7.2 æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½å¯¹æ¯”


**ğŸ“Š ä¸»æµæ–‡ä»¶ç³»ç»Ÿæ€§èƒ½ç‰¹ç‚¹**ï¼š

| **æ–‡ä»¶ç³»ç»Ÿ** | **é¡ºåºè¯»å†™** | **éšæœºè¯»å†™** | **å°æ–‡ä»¶** | **å¤§æ–‡ä»¶** | **é€‚ç”¨åœºæ™¯** |
|-------------|-------------|-------------|-----------|-----------|-------------|
| **ext4** | è‰¯å¥½ ğŸ“Š | ä¸€èˆ¬ ğŸ“‰ | ä¸€èˆ¬ ğŸ“Š | è‰¯å¥½ ğŸ“ˆ | é€šç”¨åœºæ™¯ |
| **xfs** | ä¼˜ç§€ ğŸ“ˆ | è‰¯å¥½ ğŸ“Š | è¾ƒå¼± ğŸ“‰ | ä¼˜ç§€ ğŸ“ˆ | å¤§æ–‡ä»¶å­˜å‚¨ |
| **btrfs** | è‰¯å¥½ ğŸ“Š | è‰¯å¥½ ğŸ“Š | è‰¯å¥½ ğŸ“Š | è‰¯å¥½ ğŸ“Š | ç°ä»£ç‰¹æ€§éœ€æ±‚ |
| **zfs** | ä¼˜ç§€ ğŸ“ˆ | ä¼˜ç§€ ğŸ“ˆ | è‰¯å¥½ ğŸ“Š | ä¼˜ç§€ ğŸ“ˆ | ä¼ä¸šçº§åº”ç”¨ |

**ğŸ”§ æ€§èƒ½ä¼˜åŒ–æŒ‚è½½å‚æ•°**ï¼š

```bash
# é«˜æ€§èƒ½WebæœåŠ¡å™¨é…ç½®
/dev/sdb1 /var/www ext4 defaults,noatime,data=writeback 0 2

# æ•°æ®åº“æœåŠ¡å™¨é…ç½®  
/dev/sdc1 /var/lib/mysql xfs defaults,noatime,largeio,inode64 0 2

# æ—¥å¿—æ–‡ä»¶é…ç½®
/dev/sdd1 /var/log ext4 defaults,noatime,commit=30,data=writeback 0 2

# ä¸´æ—¶æ–‡ä»¶é…ç½®
tmpfs /tmp tmpfs defaults,noatime,size=2G,mode=1777 0 0
```

### 7.3 I/Oæ€§èƒ½è°ƒä¼˜


**âš¡ I/Oè°ƒåº¦å™¨ä¼˜åŒ–**ï¼š
```bash
# æŸ¥çœ‹å½“å‰I/Oè°ƒåº¦å™¨
cat /sys/block/sda/queue/scheduler

# SSDä¼˜åŒ–ï¼šä½¿ç”¨noopæˆ–deadline
echo noop > /sys/block/sda/queue/scheduler

# HDDä¼˜åŒ–ï¼šä½¿ç”¨cfq
echo cfq > /sys/block/sda/queue/scheduler

# æ°¸ä¹…è®¾ç½®ï¼ˆåœ¨grubé…ç½®ä¸­æ·»åŠ ï¼‰
# elevator=noop
```

**ğŸ”§ æ–‡ä»¶ç³»ç»Ÿè°ƒä¼˜è„šæœ¬**ï¼š
```bash
#!/bin/bash
# filesystem_tuning.sh - æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜

# ext4æ€§èƒ½è°ƒä¼˜
tune_ext4() {
    local device=$1
    echo "Tuning ext4 filesystem on $device"
    
    # è°ƒæ•´é¢„ç•™å—æ¯”ä¾‹
    tune2fs -m 1 "$device"
    
    # å¯ç”¨æ—¥å¿—æ ¡éªŒ
    tune2fs -O journal_checksum "$device"
    
    # è°ƒæ•´æ—¥å¿—å¤§å°
    tune2fs -J size=128 "$device"
}

# xfsæ€§èƒ½è°ƒä¼˜
tune_xfs() {
    local mount_point=$1
    echo "Tuning xfs filesystem at $mount_point"
    
    # è°ƒæ•´åˆ†é…ç»„å¤§å°
    xfs_growfs -D "$mount_point"
    
    # ä¼˜åŒ–å…ƒæ•°æ®
    xfs_fsr -v "$mount_point"
}

# ç³»ç»Ÿçº§I/Oä¼˜åŒ–
tune_system_io() {
    echo "Tuning system I/O parameters"
    
    # è°ƒæ•´è™šæ‹Ÿå†…å­˜å‚æ•°
    echo 10 > /proc/sys/vm/swappiness
    echo 5 > /proc/sys/vm/dirty_background_ratio
    echo 10 > /proc/sys/vm/dirty_ratio
    
    # è°ƒæ•´å†…æ ¸I/Oå‚æ•°
    echo 16384 > /sys/block/sda/queue/read_ahead_kb
    echo 1024 > /sys/block/sda/queue/max_sectors_kb
}

# æ€§èƒ½ç›‘æ§å‡½æ•°
monitor_io_performance() {
    echo "I/O Performance Monitoring Report"
    echo "================================="
    
    # æ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µ
    echo "Disk Usage:"
    df -h
    
    echo -e "\nI/O Statistics:"
    iostat -x 1 3
    
    echo -e "\nMount Points Performance:"
    for mount in $(mount | grep -E '^/dev' | awk '{print $3}'); do
        echo "Testing $mount:"
        time dd if=/dev/zero of="$mount/test_$$" bs=1M count=100 2>/dev/null
        rm -f "$mount/test_$$"
    done
}

# ä¸»å‡½æ•°
main() {
    echo "Starting filesystem performance tuning"
    
    # æ ¹æ®æ–‡ä»¶ç³»ç»Ÿç±»å‹è¿›è¡Œè°ƒä¼˜
    while read -r device mount_point fs_type; do
        case $fs_type in
            ext4)
                tune_ext4 "$device"
                ;;
            xfs)
                tune_xfs "$mount_point"
                ;;
        esac
    done < <(mount | grep -E '^/dev' | awk '{print $1, $3, $5}')
    
    # ç³»ç»Ÿçº§è°ƒä¼˜
    tune_system_io
    
    # æ€§èƒ½ç›‘æ§
    monitor_io_performance
}

main "$@"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 ç”Ÿäº§ç¯å¢ƒæŒ‚è½½æ ¸å¿ƒåŸåˆ™


**ğŸ”¸ æ ‡å‡†åŒ–ç®¡ç†**ï¼š
- ç»Ÿä¸€çš„ç›®å½•ç»“æ„å’Œå‘½åè§„èŒƒ
- æ ‡å‡†åŒ–çš„æŒ‚è½½å‚æ•°å’Œå®‰å…¨è®¾ç½®
- æ–‡æ¡£åŒ–çš„é…ç½®ç®¡ç†æµç¨‹
- è‡ªåŠ¨åŒ–çš„éƒ¨ç½²å’Œç»´æŠ¤è„šæœ¬

**ğŸ”¸ å®‰å…¨å¯é **ï¼š
- å®Œæ•´çš„å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
- ä¸¥æ ¼çš„å˜æ›´ç®¡ç†æµç¨‹
- å®¹ç¾å’Œæ•…éšœåˆ‡æ¢ç­–ç•¥
- æŒç»­çš„ç›‘æ§å’Œå‘Šè­¦

### 8.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ æŒ‚è½½å‚æ•°ä¼˜åŒ–**ï¼š
```bash
# æ€§èƒ½ä¼˜åŒ–å‚æ•°ç»„åˆ
é«˜è¯»å†™æ€§èƒ½ï¼šdefaults,noatime,data=writeback
å®‰å…¨ä¼˜å…ˆï¼š  defaults,noatime,errors=remount-ro
æ—¥å¿—ç³»ç»Ÿï¼š  defaults,noatime,commit=30
ä¸´æ—¶å­˜å‚¨ï¼š  defaults,noatime,nodev,nosuid,noexec
```

**ğŸ”¹ ç›‘æ§æŒ‡æ ‡**ï¼š
- ç£ç›˜ä½¿ç”¨ç‡ï¼šé¿å…ç©ºé—´ä¸è¶³
- I/Oæ€§èƒ½ï¼šç›‘æ§è¯»å†™å»¶è¿Ÿ
- æŒ‚è½½çŠ¶æ€ï¼šç¡®ä¿æœåŠ¡å¯ç”¨
- é”™è¯¯æ—¥å¿—ï¼šåŠæ—¶å‘ç°é—®é¢˜

### 8.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ å®æ–½å»ºè®®**ï¼š
- **ä»å°åšèµ·**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œå†æ¨å¹¿åˆ°ç”Ÿäº§
- **æ¸è¿›æ”¹è¿›**ï¼šä¸è¦ä¸€æ¬¡æ€§æ”¹å˜å¤ªå¤šï¼Œé€æ­¥ä¼˜åŒ–
- **å……åˆ†æµ‹è¯•**ï¼šæ¯ä¸ªå˜æ›´éƒ½è¦ç»è¿‡å®Œæ•´æµ‹è¯•
- **ä¿æŒæ–‡æ¡£**ï¼šåŠæ—¶æ›´æ–°é…ç½®æ–‡æ¡£å’Œæ“ä½œæ‰‹å†Œ

**âš¡ æ•…éšœé¢„é˜²**ï¼š
- å®šæœŸæ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€
- ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
- å»ºç«‹å®Œå–„çš„å‘Šè­¦æœºåˆ¶
- åˆ¶å®šè¯¦ç»†çš„åº”æ€¥å“åº”æµç¨‹

**ğŸ”— ç›¸å…³çŸ¥è¯†æ‰©å±•**ï¼š
- å‰ç½®çŸ¥è¯†ï¼šéœ€è¦æŒæ¡åŸºæœ¬çš„Linuxæ–‡ä»¶ç³»ç»Ÿæ¦‚å¿µ
- ç›¸å…³æŠ€æœ¯ï¼šå­˜å‚¨è™šæ‹ŸåŒ–ã€ç½‘ç»œå­˜å‚¨(NFS/CIFS)
- åç»­å­¦ä¹ ï¼šå¯ä»¥æ·±å…¥å­¦ä¹ å­˜å‚¨é›†ç¾¤å’Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»æœ‰æ ‡å‡†å’Œæµç¨‹
- å˜æ›´å‰ä¸€å®šè¦åšå¥½å¤‡ä»½å’Œæµ‹è¯•  
- æ€§èƒ½ä¼˜åŒ–è¦åŸºäºå®é™…ç›‘æ§æ•°æ®
- è‡ªåŠ¨åŒ–æ˜¯æé«˜è¿ç»´æ•ˆç‡çš„å…³é”®