---
title: 11ã€è‡ªåŠ¨åŒ–å‹ç¼©è„šæœ¬å¼€å‘
---
## ğŸ“š ç›®å½•

1. [å‹ç¼©è„šæœ¬åŸºç¡€æ¦‚å¿µ](#1-å‹ç¼©è„šæœ¬åŸºç¡€æ¦‚å¿µ)
2. [æ™ºèƒ½å‹ç¼©ç­–ç•¥é€‰æ‹©](#2-æ™ºèƒ½å‹ç¼©ç­–ç•¥é€‰æ‹©)
3. [åŸºäºæ–‡ä»¶å¤§å°çš„å‹ç¼©ç­–ç•¥](#3-åŸºäºæ–‡ä»¶å¤§å°çš„å‹ç¼©ç­–ç•¥)
4. [å®šæ—¶å‹ç¼©ä»»åŠ¡é…ç½®](#4-å®šæ—¶å‹ç¼©ä»»åŠ¡é…ç½®)
5. [å‹ç¼©è¿›åº¦ç›‘æ§ä¸çŠ¶æ€æŠ¥å‘Š](#5-å‹ç¼©è¿›åº¦ç›‘æ§ä¸çŠ¶æ€æŠ¥å‘Š)
6. [é‚®ä»¶é€šçŸ¥é›†æˆç®¡ç†](#6-é‚®ä»¶é€šçŸ¥é›†æˆç®¡ç†)
7. [æ—¥å¿—è®°å½•ä¸å®¡è®¡](#7-æ—¥å¿—è®°å½•ä¸å®¡è®¡)
8. [å¤šçº¿ç¨‹å¹¶è¡Œå‹ç¼©](#8-å¤šçº¿ç¨‹å¹¶è¡Œå‹ç¼©)
9. [é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ¢å¤](#9-é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ¢å¤)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤– å‹ç¼©è„šæœ¬åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–å‹ç¼©è„šæœ¬


**é€šä¿—ç†è§£**ï¼šå°±åƒæ˜¯ä¸€ä¸ª"æ™ºèƒ½åŠ©æ‰‹"ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸åŒæƒ…å†µè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å‹ç¼©æ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰æ—¶æ‰§è¡Œå‹ç¼©ä»»åŠ¡ï¼Œè¿˜ä¼šå‘Šè¯‰ä½ è¿›åº¦å’Œç»“æœã€‚

**æ ¸å¿ƒä½œç”¨**ï¼š
```
æ‰‹åŠ¨å‹ç¼©çš„ç—›ç‚¹ï¼š
âœ— æ¯æ¬¡éƒ½è¦è®°ä½ä¸åŒçš„å‹ç¼©å‘½ä»¤
âœ— ä¸çŸ¥é“è¯¥ç”¨å“ªç§å‹ç¼©å·¥å…·æœ€å¥½
âœ— å¿˜è®°å®šæœŸå‹ç¼©å¤‡ä»½æ–‡ä»¶
âœ— å‹ç¼©å¤§æ–‡ä»¶æ—¶ä¸çŸ¥é“è¿›åº¦

è‡ªåŠ¨åŒ–è„šæœ¬è§£å†³ï¼š
âœ“ è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å‹ç¼©å·¥å…·
âœ“ æ ¹æ®æ–‡ä»¶å¤§å°æ™ºèƒ½åˆ‡æ¢ç­–ç•¥
âœ“ å®šæ—¶è‡ªåŠ¨æ‰§è¡Œå‹ç¼©ä»»åŠ¡
âœ“ å®æ—¶æ˜¾ç¤ºå‹ç¼©è¿›åº¦å’ŒçŠ¶æ€
```

### 1.2 å‹ç¼©è„šæœ¬çš„æ ¸å¿ƒåŠŸèƒ½


**ğŸ”¸ æ™ºèƒ½é€‰æ‹©åŠŸèƒ½**
```bash
# è„šæœ¬ä¼šæ ¹æ®æƒ…å†µè‡ªåŠ¨é€‰æ‹©ï¼š
æ–‡ä»¶å¾ˆå° â†’ gzipï¼ˆé€Ÿåº¦å¿«ï¼‰
æ–‡ä»¶ä¸­ç­‰ â†’ bzip2ï¼ˆå¹³è¡¡å‹ç¼©ç‡å’Œé€Ÿåº¦ï¼‰
æ–‡ä»¶å¾ˆå¤§ â†’ xzï¼ˆå‹ç¼©ç‡æœ€é«˜ï¼‰
```

**ğŸ”¸ è‡ªåŠ¨åŒ–æ‰§è¡Œ**
- å®šæ—¶å¤‡ä»½ï¼šæ¯å¤©å‡Œæ™¨è‡ªåŠ¨å‹ç¼©æ—¥å¿—æ–‡ä»¶
- æ™ºèƒ½æ¸…ç†ï¼šå‹ç¼©å®Œæˆååˆ é™¤åŸæ–‡ä»¶
- çŠ¶æ€é€šçŸ¥ï¼šå®Œæˆåå‘é‚®ä»¶å‘ŠçŸ¥ç»“æœ

### 1.3 åŸºæœ¬è„šæœ¬æ¡†æ¶


**ğŸ’» æœ€ç®€å•çš„å‹ç¼©è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# åŸºç¡€å‹ç¼©è„šæœ¬æ¡†æ¶

compress_file() {
    local file="$1"
    local size=$(stat -c%s "$file")
    
    # æ ¹æ®æ–‡ä»¶å¤§å°é€‰æ‹©å‹ç¼©æ–¹æ³•
    if [ $size -lt 1048576 ]; then  # å°äº1MB
        echo "ä½¿ç”¨gzipå‹ç¼©å°æ–‡ä»¶: $file"
        gzip "$file"
    else
        echo "ä½¿ç”¨xzå‹ç¼©å¤§æ–‡ä»¶: $file"
        xz "$file"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
compress_file "myfile.txt"
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šè¿™ä¸ªè„šæœ¬å°±åƒä¸€ä¸ªä¼šæ€è€ƒçš„å‹ç¼©å·¥å…·ï¼Œå®ƒä¼šå…ˆ"çœ‹çœ‹"æ–‡ä»¶æœ‰å¤šå¤§ï¼Œç„¶åå†³å®šç”¨ä»€ä¹ˆæ–¹æ³•å‹ç¼©æœ€åˆé€‚ã€‚

---

## 2. ğŸ§  æ™ºèƒ½å‹ç¼©ç­–ç•¥é€‰æ‹©


### 2.1 ä»€ä¹ˆæ˜¯æ™ºèƒ½å‹ç¼©ç­–ç•¥


**é€šä¿—è§£é‡Š**ï¼šå°±åƒåŒ»ç”Ÿçœ‹ç—…è¦"å¯¹ç—‡ä¸‹è¯"ä¸€æ ·ï¼Œä¸åŒç±»å‹ã€ä¸åŒå¤§å°çš„æ–‡ä»¶éœ€è¦ç”¨ä¸åŒçš„å‹ç¼©æ–¹æ³•æ‰èƒ½è¾¾åˆ°æœ€å¥½çš„æ•ˆæœã€‚

**æ ¸å¿ƒåŸç†**ï¼š
```
å‹ç¼©å·¥å…·ç‰¹ç‚¹å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‹ç¼©å·¥å…· â”‚ å‹ç¼©ç‡ â”‚ é€Ÿåº¦   â”‚ CPUå ç”¨â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ gzip    â”‚ ä¸­ç­‰   â”‚ å¾ˆå¿«   â”‚ ä½     â”‚
â”‚ bzip2   â”‚ è¾ƒé«˜   â”‚ ä¸­ç­‰   â”‚ ä¸­ç­‰   â”‚
â”‚ xz      â”‚ æœ€é«˜   â”‚ è¾ƒæ…¢   â”‚ é«˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ™ºèƒ½é€‰æ‹©ç®—æ³•å®ç°


**ğŸ’» å‹ç¼©ç­–ç•¥é€‰æ‹©è„šæœ¬**
```bash
#!/bin/bash
# æ™ºèƒ½å‹ç¼©ç­–ç•¥é€‰æ‹©

choose_compression() {
    local file="$1"
    local file_size=$(stat -c%s "$file" 2>/dev/null || echo 0)
    local file_type=$(file -b "$file")
    
    echo "ğŸ” åˆ†ææ–‡ä»¶: $file"
    echo "ğŸ“ æ–‡ä»¶å¤§å°: $(echo $file_size | numfmt --to=iec)"
    echo "ğŸ“„ æ–‡ä»¶ç±»å‹: $file_type"
    
    # æ ¹æ®æ–‡ä»¶ç±»å‹å’Œå¤§å°é€‰æ‹©ç­–ç•¥
    case "$file_type" in
        *"text"*|*"ASCII"*)
            if [ $file_size -lt 10485760 ]; then  # <10MB
                echo "ğŸš€ é€‰æ‹©ç­–ç•¥: gzip (æ–‡æœ¬æ–‡ä»¶,å°äº10MB)"
                return 0  # gzip
            else
                echo "ğŸ¯ é€‰æ‹©ç­–ç•¥: xz (æ–‡æœ¬æ–‡ä»¶,å¤§äº10MB)"
                return 2  # xz
            fi
            ;;
        *"archive"*|*"compressed"*)
            echo "âš ï¸  æ–‡ä»¶å·²å‹ç¼©ï¼Œè·³è¿‡å¤„ç†"
            return 3  # skip
            ;;
        *)
            if [ $file_size -lt 5242880 ]; then   # <5MB
                echo "ğŸš€ é€‰æ‹©ç­–ç•¥: gzip (äºŒè¿›åˆ¶æ–‡ä»¶,å°äº5MB)"
                return 0  # gzip
            elif [ $file_size -lt 52428800 ]; then # <50MB
                echo "âš–ï¸  é€‰æ‹©ç­–ç•¥: bzip2 (äºŒè¿›åˆ¶æ–‡ä»¶,ä¸­ç­‰å¤§å°)"
                return 1  # bzip2
            else
                echo "ğŸ¯ é€‰æ‹©ç­–ç•¥: xz (äºŒè¿›åˆ¶æ–‡ä»¶,å¤§äº50MB)"
                return 2  # xz
            fi
            ;;
    esac
}
```

### 2.3 å‹ç¼©æ‰§è¡Œå‡½æ•°


**ğŸ’» æ ¹æ®ç­–ç•¥æ‰§è¡Œå‹ç¼©**
```bash
execute_compression() {
    local file="$1"
    local strategy="$2"
    
    case $strategy in
        0) # gzip
            echo "ğŸš€ æ­£åœ¨ä½¿ç”¨gzipå‹ç¼©..."
            if gzip -v "$file"; then
                echo "âœ… gzipå‹ç¼©å®Œæˆ: ${file}.gz"
            else
                echo "âŒ gzipå‹ç¼©å¤±è´¥"
                return 1
            fi
            ;;
        1) # bzip2
            echo "âš–ï¸  æ­£åœ¨ä½¿ç”¨bzip2å‹ç¼©..."
            if bzip2 -v "$file"; then
                echo "âœ… bzip2å‹ç¼©å®Œæˆ: ${file}.bz2"
            else
                echo "âŒ bzip2å‹ç¼©å¤±è´¥"
                return 1
            fi
            ;;
        2) # xz
            echo "ğŸ¯ æ­£åœ¨ä½¿ç”¨xzå‹ç¼©..."
            if xz -v "$file"; then
                echo "âœ… xzå‹ç¼©å®Œæˆ: ${file}.xz"
            else
                echo "âŒ xzå‹ç¼©å¤±è´¥"
                return 1
            fi
            ;;
        3) # skip
            echo "â­ï¸  è·³è¿‡å·²å‹ç¼©æ–‡ä»¶"
            ;;
    esac
}
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼šè¿™ä¸ªè„šæœ¬å°±åƒä¸€ä¸ªç»éªŒä¸°å¯Œçš„ç®¡å®¶ï¼Œå®ƒä¼šå…ˆ"æ‰“é‡"ä¸€ä¸‹æ–‡ä»¶ï¼ˆçœ‹å¤§å°ã€çœ‹ç±»å‹ï¼‰ï¼Œç„¶åé€‰æ‹©æœ€åˆé€‚çš„"å·¥å…·"æ¥å¤„ç†ã€‚

---

## 3. ğŸ“Š åŸºäºæ–‡ä»¶å¤§å°çš„å‹ç¼©ç­–ç•¥


### 3.1 ä¸ºä»€ä¹ˆè¦æŒ‰æ–‡ä»¶å¤§å°åˆ†ç±»


**é€šä¿—ç†è§£**ï¼šå°±åƒæ¬å®¶ä¸€æ ·ï¼Œå°ä¸œè¥¿ç”¨æ‰‹æ‹¿ï¼Œä¸­ç­‰çš„ç”¨è¢‹å­ï¼Œå¤§ä»¶çš„è¦ç”¨è´§è½¦ã€‚æ–‡ä»¶å‹ç¼©ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸åŒå¤§å°çš„æ–‡ä»¶ç”¨ä¸åŒçš„æ–¹æ³•æ•ˆæœæœ€å¥½ã€‚

**å¤§å°åˆ†ç±»ç­–ç•¥**ï¼š
```
æ–‡ä»¶å¤§å°åˆ†çº§ç­–ç•¥ï¼š

ğŸŸ¢ å°æ–‡ä»¶ (< 1MB)
   ç­–ç•¥ï¼šgzip
   åŸå› ï¼šé€Ÿåº¦å¿«ï¼ŒCPUå ç”¨å°‘
   é€‚åˆï¼šé…ç½®æ–‡ä»¶ã€å°æ–‡æ¡£

ğŸŸ¡ ä¸­ç­‰æ–‡ä»¶ (1MB - 50MB)  
   ç­–ç•¥ï¼šbzip2
   åŸå› ï¼šå‹ç¼©ç‡å’Œé€Ÿåº¦å¹³è¡¡
   é€‚åˆï¼šæ™®é€šæ–‡æ¡£ã€å°æ•°æ®åº“

ğŸ”´ å¤§æ–‡ä»¶ (> 50MB)
   ç­–ç•¥ï¼šxz
   åŸå› ï¼šå‹ç¼©ç‡æœ€é«˜ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
   é€‚åˆï¼šæ—¥å¿—æ–‡ä»¶ã€å¤§æ•°æ®å¤‡ä»½
```

### 3.2 æ–‡ä»¶å¤§å°æ£€æµ‹è„šæœ¬


**ğŸ’» æ™ºèƒ½å¤§å°æ£€æµ‹**
```bash
#!/bin/bash
# åŸºäºæ–‡ä»¶å¤§å°çš„å‹ç¼©ç­–ç•¥

get_file_size_category() {
    local file="$1"
    local size=$(stat -c%s "$file" 2>/dev/null || echo 0)
    local size_mb=$((size / 1048576))  # è½¬æ¢ä¸ºMB
    
    echo "ğŸ“ æ£€æµ‹æ–‡ä»¶å¤§å°..."
    echo "   åŸå§‹å¤§å°: $(echo $size | numfmt --to=iec)"
    echo "   å¤§å°(MB): ${size_mb}MB"
    
    if [ $size -lt 1048576 ]; then      # < 1MB
        echo "ğŸŸ¢ åˆ†ç±»: å°æ–‡ä»¶ (< 1MB)"
        return 1  # å°æ–‡ä»¶
    elif [ $size -lt 52428800 ]; then   # < 50MB
        echo "ğŸŸ¡ åˆ†ç±»: ä¸­ç­‰æ–‡ä»¶ (1MB - 50MB)"
        return 2  # ä¸­ç­‰æ–‡ä»¶
    else
        echo "ğŸ”´ åˆ†ç±»: å¤§æ–‡ä»¶ (> 50MB)"
        return 3  # å¤§æ–‡ä»¶
    fi
}

# æ‰¹é‡å¤„ç†ç›®å½•ä¸­çš„æ–‡ä»¶
process_directory() {
    local dir="$1"
    local small_count=0
    local medium_count=0
    local large_count=0
    
    echo "ğŸ“ å¤„ç†ç›®å½•: $dir"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    
    for file in "$dir"/*; do
        if [ -f "$file" ]; then
            echo "ğŸ” å¤„ç†æ–‡ä»¶: $(basename "$file")"
            get_file_size_category "$file"
            case $? in
                1) ((small_count++));;
                2) ((medium_count++));;
                3) ((large_count++));;
            esac
            echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        fi
    done
    
    echo "ğŸ“Š ç»Ÿè®¡ç»“æœ:"
    echo "   ğŸŸ¢ å°æ–‡ä»¶: $small_count ä¸ª"
    echo "   ğŸŸ¡ ä¸­ç­‰æ–‡ä»¶: $medium_count ä¸ª" 
    echo "   ğŸ”´ å¤§æ–‡ä»¶: $large_count ä¸ª"
}
```

### 3.3 åŠ¨æ€ç­–ç•¥è°ƒæ•´


**ğŸ’» æ ¹æ®ç³»ç»Ÿèµ„æºè°ƒæ•´ç­–ç•¥**
```bash
# æ ¹æ®ç³»ç»Ÿè´Ÿè½½è°ƒæ•´å‹ç¼©ç­–ç•¥
adjust_strategy_by_load() {
    local file="$1"
    local base_strategy="$2"
    local cpu_load=$(uptime | awk '{print $10}' | cut -d',' -f1)
    local mem_usage=$(free | awk '/^Mem:/{printf "%.0f", $3/$2 * 100}')
    
    echo "ğŸ–¥ï¸  ç³»ç»ŸçŠ¶æ€æ£€æŸ¥:"
    echo "   CPUè´Ÿè½½: $cpu_load"
    echo "   å†…å­˜ä½¿ç”¨: ${mem_usage}%"
    
    # å¦‚æœç³»ç»Ÿè´Ÿè½½é«˜ï¼Œé€‰æ‹©æ›´è½»é‡çš„å‹ç¼©æ–¹å¼
    if (( $(echo "$cpu_load > 2.0" | bc -l) )) || [ $mem_usage -gt 80 ]; then
        echo "âš ï¸  ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ï¼Œè°ƒæ•´ä¸ºè½»é‡å‹ç¼©"
        case $base_strategy in
            2|3) # åŸæœ¬æ˜¯xzï¼Œæ”¹ä¸ºgzip
                echo "ğŸ“‰ ç­–ç•¥è°ƒæ•´: xz â†’ gzip"
                return 0
                ;;
            *) 
                return $base_strategy
                ;;
        esac
    else
        echo "âœ… ç³»ç»ŸçŠ¶æ€è‰¯å¥½ï¼Œä½¿ç”¨åŸç­–ç•¥"
        return $base_strategy
    fi
}
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**ï¼šå°±åƒå¼€è½¦ä¸€æ ·ï¼Œå¹³è·¯å¯ä»¥å¼€å¿«è½¦ï¼Œä¸Šå¡è¦é™æ¡£ã€‚ç³»ç»Ÿå¿™çš„æ—¶å€™ç”¨è½»é‡å‹ç¼©ï¼Œç³»ç»Ÿé—²çš„æ—¶å€™ç”¨é«˜æ•ˆå‹ç¼©ã€‚

---

## 4. â° å®šæ—¶å‹ç¼©ä»»åŠ¡é…ç½®


### 4.1 ä»€ä¹ˆæ˜¯å®šæ—¶å‹ç¼©ä»»åŠ¡


**é€šä¿—è§£é‡Š**ï¼šå°±åƒè®¾ç½®é—¹é’Ÿä¸€æ ·ï¼Œè®©ç³»ç»Ÿåœ¨å›ºå®šæ—¶é—´è‡ªåŠ¨æ‰§è¡Œå‹ç¼©å·¥ä½œã€‚æ¯”å¦‚æ¯å¤©å‡Œæ™¨è‡ªåŠ¨å‹ç¼©å‰ä¸€å¤©çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¯å‘¨æœ«å‹ç¼©ä¸€å‘¨çš„å¤‡ä»½æ•°æ®ã€‚

**å¸¸è§å®šæ—¶åœºæ™¯**ï¼š
```
ğŸ“… æ—¥å¸¸å®šæ—¶ä»»åŠ¡:
â€¢ æ¯æ—¥å‡Œæ™¨2ç‚¹: å‹ç¼©å½“å¤©æ—¥å¿—æ–‡ä»¶  
â€¢ æ¯å‘¨æ—¥å‡Œæ™¨: å‹ç¼©ä¸€å‘¨çš„å¤‡ä»½æ•°æ®
â€¢ æ¯æœˆ1å·: å‹ç¼©ä¸Šæœˆçš„å½’æ¡£æ–‡ä»¶
â€¢ æ¯å°æ—¶: å‹ç¼©ä¸´æ—¶æ–‡ä»¶ç›®å½•

ğŸ¯ ä¸šåŠ¡å®šæ—¶ä»»åŠ¡:
â€¢ æ•°æ®åº“å¤‡ä»½åè‡ªåŠ¨å‹ç¼©
â€¢ WebæœåŠ¡å™¨æ—¥å¿—è½®è½¬åå‹ç¼©
â€¢ ç›‘æ§æ•°æ®å®šæœŸæ‰“åŒ…å‹ç¼©
```

### 4.2 cronå®šæ—¶ä»»åŠ¡é…ç½®


**ğŸ”¸ cronæ—¶é—´è¡¨è¾¾å¼è¯¦è§£**
```bash
# cronè¡¨è¾¾å¼æ ¼å¼: åˆ† æ—¶ æ—¥ æœˆ å‘¨
# * * * * * å‘½ä»¤

# å¸¸ç”¨æ—¶é—´é…ç½®:
0 2 * * *     # æ¯å¤©å‡Œæ™¨2ç‚¹
0 2 * * 0     # æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹  
0 2 1 * *     # æ¯æœˆ1å·å‡Œæ™¨2ç‚¹
*/30 * * * *  # æ¯30åˆ†é’Ÿ
0 */6 * * *   # æ¯6å°æ—¶
```

**ğŸ’» å®šæ—¶å‹ç¼©é…ç½®ç¤ºä¾‹**
```bash
#!/bin/bash
# è®¾ç½®å®šæ—¶å‹ç¼©ä»»åŠ¡

setup_cron_jobs() {
    echo "â° é…ç½®å®šæ—¶å‹ç¼©ä»»åŠ¡..."
    
    # å¤‡ä»½å½“å‰crontab
    crontab -l > /tmp/crontab_backup 2>/dev/null || true
    
    # åˆ›å»ºæ–°çš„cronä»»åŠ¡
    cat >> /tmp/new_crontab << 'EOF'
# æ¯æ—¥æ—¥å¿—å‹ç¼© - å‡Œæ™¨2ç‚¹æ‰§è¡Œ
0 2 * * * /usr/local/bin/daily_log_compress.sh >> /var/log/compress.log 2>&1

# æ¯å‘¨æ•°æ®å¤‡ä»½å‹ç¼© - å‘¨æ—¥å‡Œæ™¨3ç‚¹
0 3 * * 0 /usr/local/bin/weekly_backup_compress.sh >> /var/log/compress.log 2>&1

# ä¸´æ—¶æ–‡ä»¶æ¸…ç†å‹ç¼© - æ¯4å°æ—¶
0 */4 * * * /usr/local/bin/temp_file_compress.sh >> /var/log/compress.log 2>&1
EOF

    # åº”ç”¨æ–°çš„crontab
    crontab /tmp/new_crontab
    echo "âœ… å®šæ—¶ä»»åŠ¡é…ç½®å®Œæˆ"
    echo "ğŸ“‹ å½“å‰å®šæ—¶ä»»åŠ¡:"
    crontab -l
}
```

### 4.3 æ—¥å¿—è½®è½¬å‹ç¼©è„šæœ¬


**ğŸ’» æ¯æ—¥æ—¥å¿—å‹ç¼©è„šæœ¬**
```bash
#!/bin/bash
# daily_log_compress.sh - æ¯æ—¥æ—¥å¿—å‹ç¼©è„šæœ¬

SCRIPT_NAME="æ—¥å¿—å‹ç¼©è„šæœ¬"
LOG_DIR="/var/log"
ARCHIVE_DIR="/var/log/archive"
DATE=$(date +%Y%m%d)
YESTERDAY=$(date -d "yesterday" +%Y%m%d)

daily_log_compress() {
    echo "ğŸ—“ï¸  [$DATE] $SCRIPT_NAME å¼€å§‹æ‰§è¡Œ"
    
    # åˆ›å»ºå½’æ¡£ç›®å½•
    mkdir -p "$ARCHIVE_DIR"
    
    # è¦å‹ç¼©çš„æ—¥å¿—æ–‡ä»¶åˆ—è¡¨
    local log_files=(
        "nginx/access.log.1"
        "nginx/error.log.1"
        "mysql/mysql.log.1"
        "app/application.log.$YESTERDAY"
    )
    
    local success_count=0
    local total_count=${#log_files[@]}
    
    for log_file in "${log_files[@]}"; do
        local full_path="$LOG_DIR/$log_file"
        
        if [ -f "$full_path" ]; then
            echo "ğŸ”„ å‹ç¼©æ–‡ä»¶: $log_file"
            
            # æ ¹æ®æ–‡ä»¶å¤§å°é€‰æ‹©å‹ç¼©æ–¹æ³•
            local size=$(stat -c%s "$full_path")
            if [ $size -gt 52428800 ]; then  # >50MBç”¨xz
                if xz -9 "$full_path"; then
                    mv "$full_path.xz" "$ARCHIVE_DIR/"
                    echo "âœ… xzå‹ç¼©å®Œæˆ: $log_file"
                    ((success_count++))
                else
                    echo "âŒ å‹ç¼©å¤±è´¥: $log_file"
                fi
            else  # <=50MBç”¨gzip
                if gzip -9 "$full_path"; then
                    mv "$full_path.gz" "$ARCHIVE_DIR/"
                    echo "âœ… gzipå‹ç¼©å®Œæˆ: $log_file"
                    ((success_count++))
                else
                    echo "âŒ å‹ç¼©å¤±è´¥: $log_file"
                fi
            fi
        else
            echo "âš ï¸  æ–‡ä»¶ä¸å­˜åœ¨: $log_file"
        fi
    done
    
    echo "ğŸ“Š å‹ç¼©ç»“æœ: $success_count/$total_count æˆåŠŸ"
    
    # æ¸…ç†30å¤©å‰çš„å‹ç¼©æ–‡ä»¶
    find "$ARCHIVE_DIR" -name "*.gz" -o -name "*.xz" -o -name "*.bz2" | \
    xargs ls -lt | tail -n +$(( $(find "$ARCHIVE_DIR" -name "*.gz" -o -name "*.xz" -o -name "*.bz2" | wc -l) - 30 )) | \
    awk '{print $9}' | xargs rm -f
    
    echo "ğŸ§¹ æ¸…ç†30å¤©å‰çš„æ—§å‹ç¼©æ–‡ä»¶å®Œæˆ"
    echo "ğŸ [$DATE] $SCRIPT_NAME æ‰§è¡Œå®Œæˆ"
}

# æ‰§è¡Œå‹ç¼©
daily_log_compress
```

> ğŸ’¡ **å®šæ—¶ä»»åŠ¡å°è´´å£«**ï¼šå°±åƒå®šé—¹é’Ÿä¸€æ ·ï¼Œè®¾ç½®å¥½æ—¶é—´è®©ç³»ç»Ÿè‡ªåŠ¨å·¥ä½œã€‚è®°ä½è¦æŠŠè„šæœ¬æ”¾åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œå¹¶ä¸”ç»™äºˆæ‰§è¡Œæƒé™ï¼ˆ`chmod +x`ï¼‰ã€‚

---

## 5. ğŸ“ˆ å‹ç¼©è¿›åº¦ç›‘æ§ä¸çŠ¶æ€æŠ¥å‘Š


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦è¿›åº¦ç›‘æ§


**é€šä¿—ç†è§£**ï¼šå‹ç¼©å¤§æ–‡ä»¶å°±åƒçƒ§æ°´ä¸€æ ·ï¼Œä½ æƒ³çŸ¥é“çƒ§åˆ°ä»€ä¹ˆç¨‹åº¦äº†ã€‚ç‰¹åˆ«æ˜¯å‹ç¼©å‡ GBçš„å¤§æ–‡ä»¶æ—¶ï¼Œå¯èƒ½è¦ç­‰å‡ ä¸ªå°æ—¶ï¼Œæ²¡æœ‰è¿›åº¦æ˜¾ç¤ºä¼šå¾ˆç„¦è™‘ã€‚

**ç›‘æ§çš„ä»·å€¼**ï¼š
```
è¿›åº¦ç›‘æ§çš„å¥½å¤„ï¼š
âœ“ çŸ¥é“è¿˜è¦ç­‰å¤šé•¿æ—¶é—´
âœ“ ç¡®è®¤ç¨‹åºæ²¡æœ‰å¡æ­»
âœ“ å¯ä»¥é¢„ä¼°å®Œæˆæ—¶é—´
âœ“ å‘ç°å¼‚å¸¸åŠæ—¶å¤„ç†

ç›‘æ§å†…å®¹ï¼š
â€¢ å‹ç¼©è¿›åº¦ç™¾åˆ†æ¯”
â€¢ å·²å¤„ç†æ–‡ä»¶å¤§å°  
â€¢ å‰©ä½™æ—¶é—´ä¼°ç®—
â€¢ å‹ç¼©é€Ÿåº¦ç»Ÿè®¡
```

### 5.2 å®ç°å‹ç¼©è¿›åº¦ç›‘æ§


**ğŸ’» å¸¦è¿›åº¦æ˜¾ç¤ºçš„å‹ç¼©å‡½æ•°**
```bash
#!/bin/bash
# å‹ç¼©è¿›åº¦ç›‘æ§å®ç°

compress_with_progress() {
    local input_file="$1"
    local compress_type="$2"
    local output_file="${input_file}.${compress_type}"
    
    echo "ğŸš€ å¼€å§‹å‹ç¼©: $input_file"
    echo "ğŸ“Š å‹ç¼©æ–¹å¼: $compress_type"
    
    # è·å–åŸæ–‡ä»¶å¤§å°
    local file_size=$(stat -c%s "$input_file")
    local file_size_mb=$((file_size / 1048576))
    
    echo "ğŸ“ åŸæ–‡ä»¶å¤§å°: ${file_size_mb}MB"
    echo "â±ï¸  å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
    
    case "$compress_type" in
        "gz")
            # ä½¿ç”¨pvæ˜¾ç¤ºè¿›åº¦çš„gzipå‹ç¼©
            pv "$input_file" | gzip > "$output_file"
            ;;
        "bz2")
            pv "$input_file" | bzip2 > "$output_file"
            ;;
        "xz")
            pv "$input_file" | xz > "$output_file"
            ;;
    esac
    
    if [ $? -eq 0 ]; then
        local compressed_size=$(stat -c%s "$output_file")
        local compressed_mb=$((compressed_size / 1048576))
        local ratio=$((100 - (compressed_size * 100 / file_size)))
        
        echo ""
        echo "âœ… å‹ç¼©å®Œæˆ!"
        echo "ğŸ“Š å‹ç¼©ç»Ÿè®¡:"
        echo "   åŸå§‹å¤§å°: ${file_size_mb}MB"
        echo "   å‹ç¼©å: ${compressed_mb}MB" 
        echo "   å‹ç¼©ç‡: ${ratio}%"
        echo "â±ï¸  å®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
    else
        echo "âŒ å‹ç¼©å¤±è´¥!"
        return 1
    fi
}
```

### 5.3 æ‰¹é‡æ–‡ä»¶è¿›åº¦ç›‘æ§


**ğŸ’» æ‰¹é‡å‹ç¼©è¿›åº¦è¿½è¸ª**
```bash
# æ‰¹é‡æ–‡ä»¶å‹ç¼©è¿›åº¦ç›‘æ§
batch_compress_monitor() {
    local source_dir="$1"
    local target_dir="$2"
    
    # åˆ›å»ºç›®æ ‡ç›®å½•
    mkdir -p "$target_dir"
    
    # ç»Ÿè®¡è¦å¤„ç†çš„æ–‡ä»¶
    local file_list=($(find "$source_dir" -type f -name "*.log" -o -name "*.txt"))
    local total_files=${#file_list[@]}
    local current_file=0
    local success_count=0
    local fail_count=0
    
    echo "ğŸ“ æ‰¹é‡å‹ç¼©ç›‘æ§"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“‚ æºç›®å½•: $source_dir"  
    echo "ğŸ“‚ ç›®æ ‡ç›®å½•: $target_dir"
    echo "ğŸ“Š æ–‡ä»¶æ€»æ•°: $total_files"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    
    # è®°å½•å¼€å§‹æ—¶é—´
    local start_time=$(date +%s)
    
    for file in "${file_list[@]}"; do
        ((current_file++))
        local progress=$((current_file * 100 / total_files))
        
        echo ""
        echo "ğŸ“ è¿›åº¦: [$current_file/$total_files] ($progress%)"
        echo "ğŸ”„ å½“å‰æ–‡ä»¶: $(basename "$file")"
        
        # å‹ç¼©æ–‡ä»¶
        if compress_with_progress "$file" "xz"; then
            ((success_count++))
            # ç§»åŠ¨åˆ°ç›®æ ‡ç›®å½•
            mv "${file}.xz" "$target_dir/"
            # åˆ é™¤åŸæ–‡ä»¶
            rm "$file"
        else
            ((fail_count++))
        fi
        
        # æ˜¾ç¤ºå‰©ä½™æ—¶é—´ä¼°ç®—
        local current_time=$(date +%s)
        local elapsed=$((current_time - start_time))
        local avg_time=$((elapsed / current_file))
        local remaining_files=$((total_files - current_file))
        local eta=$((remaining_files * avg_time))
        
        echo "â±ï¸  é¢„è®¡å‰©ä½™æ—¶é—´: $(date -d@$eta -u +%H:%M:%S)"
    done
    
    # æœ€ç»ˆç»Ÿè®¡
    local end_time=$(date +%s)
    local total_time=$((end_time - start_time))
    
    echo ""
    echo "ğŸ æ‰¹é‡å‹ç¼©å®Œæˆ!"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“Š æœ€ç»ˆç»Ÿè®¡:"
    echo "   âœ… æˆåŠŸ: $success_count ä¸ªæ–‡ä»¶"
    echo "   âŒ å¤±è´¥: $fail_count ä¸ªæ–‡ä»¶"
    echo "   â±ï¸  æ€»è€—æ—¶: $(date -d@$total_time -u +%H:%M:%S)"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}
```

> ğŸ’¡ **è¿›åº¦ç›‘æ§å°è´´å£«**ï¼š`pv`å‘½ä»¤æ˜¯æ˜¾ç¤ºè¿›åº¦çš„ç¥å™¨ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å¯ä»¥ç”¨`yum install pv`æˆ–`apt install pv`å®‰è£…ã€‚å®ƒå°±åƒç»™å‘½ä»¤åŠ äº†ä¸€ä¸ªè¿›åº¦æ¡ï¼Œè®©ä½ æ¸…æ¥šåœ°çœ‹åˆ°å¤„ç†è¿›åº¦ã€‚

---

## 6. ğŸ“§ é‚®ä»¶é€šçŸ¥é›†æˆç®¡ç†


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦é‚®ä»¶é€šçŸ¥


**é€šä¿—ç†è§£**ï¼šå°±åƒå¿«é€’å®Œæˆåå‘çŸ­ä¿¡é€šçŸ¥ä¸€æ ·ï¼Œå‹ç¼©ä»»åŠ¡å®Œæˆåå‘é‚®ä»¶å‘Šè¯‰ä½ ç»“æœã€‚ç‰¹åˆ«æ˜¯å®šæ—¶ä»»åŠ¡åœ¨åŠå¤œæ‰§è¡Œï¼Œç¬¬äºŒå¤©ä¸Šç­å°±èƒ½æ”¶åˆ°é‚®ä»¶çŸ¥é“æ˜¨æ™šçš„å‹ç¼©æƒ…å†µã€‚

**é€šçŸ¥åœºæ™¯**ï¼š
```
ğŸŸ¢ æˆåŠŸé€šçŸ¥ï¼š
â€¢ å‹ç¼©ä»»åŠ¡æ­£å¸¸å®Œæˆ
â€¢ å‹ç¼©ç‡å’Œæ–‡ä»¶å¤§å°ç»Ÿè®¡
â€¢ èŠ‚çœçš„å­˜å‚¨ç©ºé—´

ğŸŸ¡ è­¦å‘Šé€šçŸ¥ï¼š
â€¢ å‹ç¼©ç‡å¼‚å¸¸ä½
â€¢ ç£ç›˜ç©ºé—´ä¸è¶³è­¦å‘Š
â€¢ éƒ¨åˆ†æ–‡ä»¶å‹ç¼©å¤±è´¥

ğŸ”´ é”™è¯¯é€šçŸ¥ï¼š
â€¢ å‹ç¼©ä»»åŠ¡å®Œå…¨å¤±è´¥
â€¢ ç³»ç»Ÿèµ„æºä¸è¶³
â€¢ æƒé™æˆ–è·¯å¾„é—®é¢˜
```

### 6.2 é‚®ä»¶é€šçŸ¥é…ç½®


**ğŸ’» é‚®ä»¶å‘é€é…ç½®**
```bash
#!/bin/bash
# é‚®ä»¶é€šçŸ¥é…ç½®

# é‚®ä»¶é…ç½®å‚æ•°
MAIL_TO="admin@company.com"
MAIL_CC="backup@company.com"
MAIL_FROM="server@company.com"
SMTP_SERVER="smtp.company.com"

# å‘é€é‚®ä»¶å‡½æ•°
send_notification() {
    local subject="$1"
    local message="$2"
    local priority="$3"  # high/normal/low
    local attachment="$4"
    
    # åˆ›å»ºé‚®ä»¶å†…å®¹
    local mail_file="/tmp/mail_content_$$"
    
    cat > "$mail_file" << EOF
From: æœåŠ¡å™¨ç›‘æ§ç³»ç»Ÿ <$MAIL_FROM>
To: $MAIL_TO
CC: $MAIL_CC
Subject: $subject
Content-Type: text/html; charset=UTF-8
Priority: $priority

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; }
        .header { background-color: #f4f4f4; padding: 10px; }
        .content { margin: 20px 0; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .error { color: #dc3545; }
        .stats { background-color: #e9ecef; padding: 10px; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <div class="header">
        <h2>ğŸ¤– è‡ªåŠ¨åŒ–å‹ç¼©ç³»ç»Ÿé€šçŸ¥</h2>
    </div>
    <div class="content">
        $message
    </div>
    <div class="footer">
        <p><small>å‘é€æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')</small></p>
        <p><small>æœåŠ¡å™¨: $(hostname)</small></p>
    </div>
</body>
</html>
EOF

    # å‘é€é‚®ä»¶
    if [ -n "$attachment" ] && [ -f "$attachment" ]; then
        # å¸¦é™„ä»¶å‘é€
        mutt -e "set content_type=text/html" -s "$subject" -a "$attachment" -- "$MAIL_TO" < "$mail_file"
    else
        # æ™®é€šå‘é€
        mutt -e "set content_type=text/html" -s "$subject" -- "$MAIL_TO" < "$mail_file"
    fi
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f "$mail_file"
    
    echo "ğŸ“§ é‚®ä»¶é€šçŸ¥å·²å‘é€: $subject"
}
```

### 6.3 å‹ç¼©ä»»åŠ¡ç»“æœé€šçŸ¥


**ğŸ’» ä»»åŠ¡å®Œæˆé€šçŸ¥è„šæœ¬**
```bash
# å‹ç¼©ä»»åŠ¡å®Œæˆé€šçŸ¥
send_compression_report() {
    local task_name="$1"
    local start_time="$2"
    local end_time="$3"
    local success_count="$4"
    local fail_count="$5"
    local total_size_before="$6"
    local total_size_after="$7"
    
    local duration=$((end_time - start_time))
    local compression_ratio=$(( (total_size_before - total_size_after) * 100 / total_size_before ))
    local saved_space=$(( (total_size_before - total_size_after) / 1048576 ))
    
    # ç¡®å®šé‚®ä»¶ç±»å‹å’Œä¼˜å…ˆçº§
    local mail_priority="normal"
    local status_icon="ğŸŸ¢"
    local status_class="success"
    
    if [ $fail_count -gt 0 ]; then
        if [ $fail_count -gt $success_count ]; then
            mail_priority="high"
            status_icon="ğŸ”´"
            status_class="error"
        else
            mail_priority="normal"
            status_icon="ğŸŸ¡"
            status_class="warning"
        fi
    fi
    
    # æ„å»ºé‚®ä»¶å†…å®¹
    local message="
    <h3 class=\"$status_class\">$status_icon å‹ç¼©ä»»åŠ¡æŠ¥å‘Š: $task_name</h3>
    
    <div class=\"stats\">
        <h4>ğŸ“Š æ‰§è¡Œç»Ÿè®¡</h4>
        <ul>
            <li><strong>å¼€å§‹æ—¶é—´:</strong> $(date -d@$start_time '+%Y-%m-%d %H:%M:%S')</li>
            <li><strong>ç»“æŸæ—¶é—´:</strong> $(date -d@$end_time '+%Y-%m-%d %H:%M:%S')</li>
            <li><strong>æ‰§è¡Œè€—æ—¶:</strong> $(date -d@$duration -u +%H:%M:%S)</li>
        </ul>
        
        <h4>ğŸ“ˆ å‹ç¼©ç»“æœ</h4>
        <ul>
            <li class=\"success\"><strong>âœ… æˆåŠŸæ–‡ä»¶:</strong> $success_count ä¸ª</li>
            <li class=\"error\"><strong>âŒ å¤±è´¥æ–‡ä»¶:</strong> $fail_count ä¸ª</li>
            <li><strong>ğŸ“ åŸå§‹å¤§å°:</strong> $(echo $total_size_before | numfmt --to=iec)</li>
            <li><strong>ğŸ“¦ å‹ç¼©å:</strong> $(echo $total_size_after | numfmt --to=iec)</li>
            <li class=\"success\"><strong>ğŸ¯ å‹ç¼©ç‡:</strong> ${compression_ratio}%</li>
            <li class=\"success\"><strong>ğŸ’¾ èŠ‚çœç©ºé—´:</strong> ${saved_space}MB</li>
        </ul>
    </div>
    
    <div class=\"content\">
        <h4>ğŸ’¡ å»ºè®®</h4>
        <ul>"
    
    # æ·»åŠ å»ºè®®ä¿¡æ¯
    if [ $compression_ratio -lt 20 ]; then
        message="$message<li class=\"warning\">âš ï¸ å‹ç¼©ç‡è¾ƒä½ï¼Œå»ºè®®æ£€æŸ¥æ–‡ä»¶ç±»å‹æ˜¯å¦é€‚åˆå‹ç¼©</li>"
    fi
    
    if [ $fail_count -gt 0 ]; then
        message="$message<li class=\"error\">ğŸ” æœ‰ $fail_count ä¸ªæ–‡ä»¶å‹ç¼©å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—</li>"
    fi
    
    if [ $saved_space -gt 1000 ]; then
        message="$message<li class=\"success\">ğŸ‰ èŠ‚çœäº†å¤§é‡å­˜å‚¨ç©ºé—´ï¼Œå‹ç¼©æ•ˆæœæ˜¾è‘—</li>"
    fi
    
    message="$message
        </ul>
    </div>"
    
    # å‘é€é‚®ä»¶
    send_notification "[$status_icon] å‹ç¼©ä»»åŠ¡å®Œæˆ - $task_name" "$message" "$mail_priority"
}
```

> ğŸ’¡ **é‚®ä»¶é€šçŸ¥æç¤º**ï¼šé‚®ä»¶é€šçŸ¥éœ€è¦å…ˆé…ç½®é‚®ä»¶å®¢æˆ·ç«¯ï¼ˆå¦‚muttæˆ–sendmailï¼‰ã€‚HTMLæ ¼å¼çš„é‚®ä»¶æ›´ç¾è§‚ï¼Œä½†çº¯æ–‡æœ¬æ ¼å¼å…¼å®¹æ€§æ›´å¥½ã€‚

---

## 7. ğŸ“ æ—¥å¿—è®°å½•ä¸å®¡è®¡


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—è®°å½•


**é€šä¿—ç†è§£**ï¼šæ—¥å¿—å°±åƒæ˜¯"è¡Œè½¦è®°å½•ä»ª"ï¼Œè®°å½•ä¸‹å‹ç¼©è„šæœ¬åšäº†ä»€ä¹ˆäº‹æƒ…ã€ä»€ä¹ˆæ—¶å€™åšçš„ã€ç»“æœæ€ä¹ˆæ ·ã€‚å‡ºäº†é—®é¢˜å¯ä»¥å›çœ‹æ—¥å¿—æ‰¾åŸå› ï¼Œä¹Ÿå¯ä»¥ç»Ÿè®¡å‹ç¼©æ•ˆæœã€‚

**æ—¥å¿—çš„ä½œç”¨**ï¼š
```
ğŸ” æ•…éšœæ’æŸ¥ï¼š
â€¢ å‹ç¼©å¤±è´¥çš„å…·ä½“åŸå› 
â€¢ ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
â€¢ æ–‡ä»¶æƒé™é—®é¢˜å®šä½

ğŸ“Š æ€§èƒ½åˆ†æï¼š
â€¢ ä¸åŒå‹ç¼©ç®—æ³•çš„æ•ˆæœå¯¹æ¯”
â€¢ å‹ç¼©é€Ÿåº¦å’ŒCPUä½¿ç”¨ç‡ç»Ÿè®¡
â€¢ å­˜å‚¨ç©ºé—´èŠ‚çœæƒ…å†µ

ğŸ” å®‰å…¨å®¡è®¡ï¼š
â€¢ è°åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œäº†å‹ç¼©
â€¢ å¤„ç†äº†å“ªäº›æ•æ„Ÿæ–‡ä»¶
â€¢ æ˜¯å¦æœ‰å¼‚å¸¸æ“ä½œ
```

### 7.2 æ—¥å¿—æ ¼å¼è®¾è®¡


**ğŸ’» æ ‡å‡†åŒ–æ—¥å¿—æ ¼å¼**
```bash
#!/bin/bash
# æ—¥å¿—è®°å½•å‡½æ•°

# æ—¥å¿—é…ç½®
LOG_DIR="/var/log/compression"
LOG_FILE="$LOG_DIR/compression.log"
ERROR_LOG="$LOG_DIR/compression_error.log"
AUDIT_LOG="$LOG_DIR/compression_audit.log"

# ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨
mkdir -p "$LOG_DIR"

# å†™æ—¥å¿—å‡½æ•°
write_log() {
    local level="$1"    # INFO/WARN/ERROR
    local message="$2"
    local category="$3" # COMPRESS/MONITOR/MAILç­‰
    
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local hostname=$(hostname)
    local pid=$$
    local user=$(whoami)
    
    # ç»Ÿä¸€æ—¥å¿—æ ¼å¼
    local log_entry="[$timestamp] [$level] [$category] [PID:$pid] [USER:$user] [HOST:$hostname] $message"
    
    # å†™å…¥ä¸»æ—¥å¿—
    echo "$log_entry" >> "$LOG_FILE"
    
    # é”™è¯¯çº§åˆ«é¢å¤–å†™å…¥é”™è¯¯æ—¥å¿—
    if [ "$level" = "ERROR" ]; then
        echo "$log_entry" >> "$ERROR_LOG"
    fi
    
    # åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°
    case "$level" in
        "INFO")  echo "â„¹ï¸  $message" ;;
        "WARN")  echo "âš ï¸  $message" ;;
        "ERROR") echo "âŒ $message" ;;
    esac
}

# å®¡è®¡æ—¥å¿—å‡½æ•°
write_audit_log() {
    local action="$1"       # START/COMPLETE/FAIL
    local file_path="$2"    
    local original_size="$3"
    local compressed_size="$4"
    local compression_type="$5"
    
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local user=$(whoami)
    local compression_ratio=""
    
    if [ -n "$original_size" ] && [ -n "$compressed_size" ] && [ "$original_size" -gt 0 ]; then
        compression_ratio=$(( (original_size - compressed_size) * 100 / original_size ))
    fi
    
    # å®¡è®¡æ—¥å¿—æ ¼å¼
    local audit_entry="$timestamp|$user|$action|$file_path|$original_size|$compressed_size|$compression_type|${compression_ratio}%"
    
    echo "$audit_entry" >> "$AUDIT_LOG"
}
```

### 7.3 è¯¦ç»†å‹ç¼©è¿‡ç¨‹è®°å½•


**ğŸ’» å‹ç¼©è¿‡ç¨‹æ—¥å¿—è®°å½•**
```bash
# å¸¦å®Œæ•´æ—¥å¿—çš„å‹ç¼©å‡½æ•°
compress_with_logging() {
    local file="$1"
    local compress_type="$2"
    
    write_log "INFO" "å¼€å§‹å‹ç¼©æ–‡ä»¶: $file (ç±»å‹: $compress_type)" "COMPRESS"
    write_audit_log "START" "$file" "$(stat -c%s "$file" 2>/dev/null || echo 0)" "" "$compress_type"
    
    # è®°å½•å¼€å§‹æ—¶é—´å’Œç³»ç»ŸçŠ¶æ€
    local start_time=$(date +%s)
    local start_cpu=$(grep 'cpu ' /proc/stat | awk '{usage=($2+$4)*100/($2+$4+$5)} END {print usage}')
    local start_mem=$(free | awk '/^Mem:/{printf "%.1f", $3/$2 * 100}')
    
    write_log "INFO" "ç³»ç»ŸçŠ¶æ€ - CPU: ${start_cpu}%, å†…å­˜: ${start_mem}%" "MONITOR"
    
    # æ‰§è¡Œå‹ç¼©
    local original_size=$(stat -c%s "$file")
    local compressed_file=""
    local success=false
    
    case "$compress_type" in
        "gzip")
            write_log "INFO" "ä½¿ç”¨gzipå‹ç¼©ç®—æ³•" "COMPRESS"
            if gzip -v "$file" 2>> "$ERROR_LOG"; then
                compressed_file="${file}.gz"
                success=true
            fi
            ;;
        "bzip2")
            write_log "INFO" "ä½¿ç”¨bzip2å‹ç¼©ç®—æ³•" "COMPRESS"
            if bzip2 -v "$file" 2>> "$ERROR_LOG"; then
                compressed_file="${file}.bz2"
                success=true
            fi
            ;;
        "xz")
            write_log "INFO" "ä½¿ç”¨xzå‹ç¼©ç®—æ³•" "COMPRESS"
            if xz -v "$file" 2>> "$ERROR_LOG"; then
                compressed_file="${file}.xz"
                success=true
            fi
            ;;
    esac
    
    # è®°å½•ç»“æœ
    local end_time=$(date +%s)
    local duration=$((end_time - start_time))
    
    if $success && [ -f "$compressed_file" ]; then
        local compressed_size=$(stat -c%s "$compressed_file")
        local compression_ratio=$(( (original_size - compressed_size) * 100 / original_size ))
        
        write_log "INFO" "å‹ç¼©æˆåŠŸ - è€—æ—¶: ${duration}s, å‹ç¼©ç‡: ${compression_ratio}%" "COMPRESS"
        write_log "INFO" "æ–‡ä»¶å¤§å°: $(numfmt --to=iec $original_size) â†’ $(numfmt --to=iec $compressed_size)" "COMPRESS"
        
        write_audit_log "COMPLETE" "$file" "$original_size" "$compressed_size" "$compress_type"
        
        return 0
    else
        write_log "ERROR" "å‹ç¼©å¤±è´¥ - è€—æ—¶: ${duration}s" "COMPRESS"
        write_audit_log "FAIL" "$file" "$original_size" "0" "$compress_type"
        
        return 1
    fi
}
```

### 7.4 æ—¥å¿—åˆ†æå’ŒæŠ¥å‘Š


**ğŸ’» æ—¥å¿—åˆ†æè„šæœ¬**
```bash
# æ—¥å¿—åˆ†æå’Œç»Ÿè®¡
analyze_compression_logs() {
    local days="${1:-7}"  # é»˜è®¤åˆ†ææœ€è¿‘7å¤©
    local report_file="/tmp/compression_report_$(date +%Y%m%d).html"
    
    write_log "INFO" "å¼€å§‹åˆ†ææœ€è¿‘ ${days} å¤©çš„å‹ç¼©æ—¥å¿—" "ANALYSIS"
    
    # ä»å®¡è®¡æ—¥å¿—æå–æ•°æ®
    local temp_data="/tmp/audit_analysis_$$"
    awk -F'|' -v days="$days" '
    BEGIN {
        cutoff = systime() - (days * 24 * 3600)
        success_count = 0
        fail_count = 0
        total_original = 0
        total_compressed = 0
    }
    {
        # è½¬æ¢æ—¶é—´æˆ³å¹¶è¿‡æ»¤
        cmd = "date -d \"" $1 "\" +%s"
        cmd | getline timestamp
        close(cmd)
        
        if (timestamp >= cutoff) {
            if ($3 == "COMPLETE") {
                success_count++
                total_original += $5
                total_compressed += $6
            } else if ($3 == "FAIL") {
                fail_count++
            }
        }
    }
    END {
        print "SUCCESS:" success_count
        print "FAIL:" fail_count  
        print "ORIGINAL:" total_original
        print "COMPRESSED:" total_compressed
        if (total_original > 0) {
            print "RATIO:" int((total_original - total_compressed) * 100 / total_original)
        }
    }
    ' "$AUDIT_LOG" > "$temp_data"
    
    # è§£æç»Ÿè®¡ç»“æœ
    local success_count=$(grep "SUCCESS:" "$temp_data" | cut -d':' -f2)
    local fail_count=$(grep "FAIL:" "$temp_data" | cut -d':' -f2)
    local total_original=$(grep "ORIGINAL:" "$temp_data" | cut -d':' -f2)
    local total_compressed=$(grep "COMPRESSED:" "$temp_data" | cut -d':' -f2)
    local avg_ratio=$(grep "RATIO:" "$temp_data" | cut -d':' -f2)
    
    # ç”ŸæˆHTMLæŠ¥å‘Š
    cat > "$report_file" << EOF
<!DOCTYPE html>
<html>
<head>
    <title>å‹ç¼©æ—¥å¿—åˆ†ææŠ¥å‘Š</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>ğŸ“Š å‹ç¼©ç³»ç»Ÿåˆ†ææŠ¥å‘Š</h1>
    <p>åˆ†æå‘¨æœŸ: æœ€è¿‘ $days å¤©</p>
    
    <h2>ğŸ“ˆ æ€»ä½“ç»Ÿè®¡</h2>
    <ul>
        <li>âœ… æˆåŠŸä»»åŠ¡: $success_count æ¬¡</li>
        <li>âŒ å¤±è´¥ä»»åŠ¡: $fail_count æ¬¡</li>
        <li>ğŸ“ åŸå§‹æ€»å¤§å°: $(echo $total_original | numfmt --to=iec)</li>
        <li>ğŸ“¦ å‹ç¼©æ€»å¤§å°: $(echo $total_compressed | numfmt --to=iec)</li>
        <li>ğŸ¯ å¹³å‡å‹ç¼©ç‡: ${avg_ratio}%</li>
        <li>ğŸ’¾ èŠ‚çœç©ºé—´: $(echo $((total_original - total_compressed)) | numfmt --to=iec)</li>
    </ul>
</body>
</html>
EOF

    write_log "INFO" "æ—¥å¿—åˆ†æå®Œæˆï¼ŒæŠ¥å‘Šæ–‡ä»¶: $report_file" "ANALYSIS"
    echo "ğŸ“‹ åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f "$temp_data"
}
```

> ğŸ’¡ **æ—¥å¿—ç®¡ç†æç¤º**ï¼šæ—¥å¿—æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå»ºè®®è®¾ç½®æ—¥å¿—è½®è½¬ï¼ˆlogrotateï¼‰ï¼Œå®šæœŸå‹ç¼©å’Œæ¸…ç†æ—§æ—¥å¿—ã€‚å®¡è®¡æ—¥å¿—ç‰¹åˆ«é‡è¦ï¼Œå¯ä»¥å•ç‹¬å¤‡ä»½ä¿å­˜ã€‚

---

## 8. âš¡ å¤šçº¿ç¨‹å¹¶è¡Œå‹ç¼©


### 8.1 ä»€ä¹ˆæ˜¯å¹¶è¡Œå‹ç¼©


**é€šä¿—ç†è§£**ï¼šå°±åƒåŒæ—¶å¼€å¤šä¸ªçª—å£åŠäº‹ä¸€æ ·ï¼Œæ™®é€šå‹ç¼©æ˜¯æ’é˜Ÿä¸€ä¸ªä¸€ä¸ªæ¥ï¼Œå¹¶è¡Œå‹ç¼©æ˜¯åŒæ—¶å¤„ç†å¤šä¸ªæ–‡ä»¶ï¼Œå¤§å¤§æé«˜æ•ˆç‡ã€‚ç‰¹åˆ«æ˜¯æœ‰å¾ˆå¤šå°æ–‡ä»¶æ—¶ï¼Œå¹¶è¡Œå¤„ç†èƒ½èŠ‚çœå¤§é‡æ—¶é—´ã€‚

**å¹¶è¡Œçš„ä¼˜åŠ¿**ï¼š
```
å•çº¿ç¨‹å¤„ç†ï¼š
æ–‡ä»¶1 â†’ å‹ç¼© â†’ å®Œæˆ
æ–‡ä»¶2 â†’ å‹ç¼© â†’ å®Œæˆ  
æ–‡ä»¶3 â†’ å‹ç¼© â†’ å®Œæˆ
æ€»è€—æ—¶ = æ—¶é—´1 + æ—¶é—´2 + æ—¶é—´3

å¹¶è¡Œå¤„ç†ï¼š
æ–‡ä»¶1 â†’ å‹ç¼© â”
æ–‡ä»¶2 â†’ å‹ç¼© â”¼â†’ åŒæ—¶è¿›è¡Œ
æ–‡ä»¶3 â†’ å‹ç¼© â”˜
æ€»è€—æ—¶ â‰ˆ max(æ—¶é—´1, æ—¶é—´2, æ—¶é—´3)
```

### 8.2 åŸºäºxargsçš„å¹¶è¡Œå®ç°


**ğŸ’» ç®€å•å¹¶è¡Œå‹ç¼©è„šæœ¬**
```bash
#!/bin/bash
# åŸºäºxargsçš„å¹¶è¡Œå‹ç¼©

parallel_compress_simple() {
    local source_dir="$1"
    local max_jobs="${2:-4}"  # é»˜è®¤4ä¸ªå¹¶å‘
    
    write_log "INFO" "å¼€å§‹å¹¶è¡Œå‹ç¼©ï¼Œå¹¶å‘æ•°: $max_jobs" "PARALLEL"
    
    # æŸ¥æ‰¾è¦å‹ç¼©çš„æ–‡ä»¶
    find "$source_dir" -type f \( -name "*.log" -o -name "*.txt" \) \
        -size +1M | \
    xargs -I {} -P "$max_jobs" bash -c '
        file="$1"
        echo "ğŸ”„ å¤„ç†æ–‡ä»¶: $(basename "$file")"
        
        # é€‰æ‹©å‹ç¼©æ–¹æ³•
        size=$(stat -c%s "$file")
        if [ $size -lt 52428800 ]; then  # <50MBç”¨gzip
            if gzip -9 "$file"; then
                echo "âœ… gzipå®Œæˆ: $(basename "$file")"
            else
                echo "âŒ gzipå¤±è´¥: $(basename "$file")"
            fi
        else  # >=50MBç”¨xz
            if xz -9 "$file"; then
                echo "âœ… xzå®Œæˆ: $(basename "$file")"
            else
                echo "âŒ xzå¤±è´¥: $(basename "$file")"
            fi
        fi
    ' _ {}
    
    write_log "INFO" "å¹¶è¡Œå‹ç¼©ä»»åŠ¡å®Œæˆ" "PARALLEL"
}
```

### 8.3 åŸºäºåå°è¿›ç¨‹çš„å¹¶è¡Œæ§åˆ¶


**ğŸ’» é«˜çº§å¹¶è¡Œå‹ç¼©æ§åˆ¶**
```bash
#!/bin/bash
# é«˜çº§å¹¶è¡Œå‹ç¼©å®ç°

# å…¨å±€å˜é‡
ACTIVE_JOBS=0
MAX_JOBS=4
JOB_PIDS=()
COMPLETED_JOBS=0
FAILED_JOBS=0

# å‹ç¼©å•ä¸ªæ–‡ä»¶çš„åå°å‡½æ•°
compress_background() {
    local file="$1"
    local job_id="$2"
    
    exec > "/tmp/compress_job_${job_id}.log" 2>&1
    
    echo "[$(date '+%H:%M:%S')] ä½œä¸š $job_id å¼€å§‹å¤„ç†: $(basename "$file")"
    
    local start_time=$(date +%s)
    local original_size=$(stat -c%s "$file")
    
    # æ ¹æ®æ–‡ä»¶å¤§å°é€‰æ‹©å‹ç¼©æ–¹æ³•
    local compress_cmd=""
    local output_ext=""
    
    if [ $original_size -lt 10485760 ]; then  # <10MB
        compress_cmd="gzip -9"
        output_ext="gz"
    elif [ $original_size -lt 104857600 ]; then  # <100MB
        compress_cmd="bzip2 -9"
        output_ext="bz2"
    else
        compress_cmd="xz -9"
        output_ext="xz"
    fi
    
    echo "[$(date '+%H:%M:%S')] ä½¿ç”¨ $compress_cmd å‹ç¼©"
    
    # æ‰§è¡Œå‹ç¼©
    if $compress_cmd "$file"; then
        local end_time=$(date +%s)
        local duration=$((end_time - start_time))
        local compressed_size=$(stat -c%s "${file}.${output_ext}")
        local ratio=$(( (original_size - compressed_size) * 100 / original_size ))
        
        echo "[$(date '+%H:%M:%S')] ä½œä¸š $job_id æˆåŠŸå®Œæˆ"
        echo "   è€—æ—¶: ${duration}s"
        echo "   å‹ç¼©ç‡: ${ratio}%"
        echo "   å¤§å°: $(numfmt --to=iec $original_size) â†’ $(numfmt --to=iec $compressed_size)"
        
        exit 0  # æˆåŠŸé€€å‡º
    else
        echo "[$(date '+%H:%M:%S')] ä½œä¸š $job_id å‹ç¼©å¤±è´¥"
        exit 1  # å¤±è´¥é€€å‡º
    fi
}

# å¯åŠ¨å‹ç¼©ä½œä¸š
start_compress_job() {
    local file="$1"
    local job_id=$((COMPLETED_JOBS + FAILED_JOBS + ACTIVE_JOBS + 1))
    
    echo "ğŸš€ å¯åŠ¨ä½œä¸š $job_id: $(basename "$file")"
    
    # åœ¨åå°å¯åŠ¨å‹ç¼©
    compress_background "$file" "$job_id" &
    local pid=$!
    
    # è®°å½•è¿›ç¨‹ä¿¡æ¯
    JOB_PIDS+=($pid)
    ((ACTIVE_JOBS++))
    
    echo "   PID: $pid, å½“å‰æ´»è·ƒä½œä¸š: $ACTIVE_JOBS"
}

# ç­‰å¾…ä½œä¸šå®Œæˆ
wait_for_job_completion() {
    local timeout="${1:-300}"  # é»˜è®¤5åˆ†é’Ÿè¶…æ—¶
    
    echo "â³ ç­‰å¾…ä½œä¸šå®Œæˆï¼Œæ´»è·ƒä½œä¸šæ•°: $ACTIVE_JOBS"
    
    for pid in "${JOB_PIDS[@]}"; do
        if kill -0 "$pid" 2>/dev/null; then  # æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨
            echo "   ç­‰å¾… PID $pid å®Œæˆ..."
            
            if wait "$pid"; then
                echo "   âœ… PID $pid æˆåŠŸå®Œæˆ"
                ((COMPLETED_JOBS++))
            else
                echo "   âŒ PID $pid æ‰§è¡Œå¤±è´¥"
                ((FAILED_JOBS++))
            fi
            
            ((ACTIVE_JOBS--))
            
            # æ˜¾ç¤ºä½œä¸šæ—¥å¿—
            local job_log="/tmp/compress_job_*.log"
            if ls $job_log 1> /dev/null 2>&1; then
                echo "   ğŸ“‹ ä½œä¸šæ—¥å¿—:"
                tail -n 3 $job_log | sed 's/^/      /'
            fi
        fi
    done
    
    # æ¸…ç©ºä½œä¸šæ•°ç»„
    JOB_PIDS=()
}

# ä¸»å¹¶è¡Œå‹ç¼©å‡½æ•°
parallel_compress_advanced() {
    local source_dir="$1"
    local max_concurrent="${2:-4}"
    
    MAX_JOBS="$max_concurrent"
    
    echo "âš¡ é«˜çº§å¹¶è¡Œå‹ç¼©å¼€å§‹"
    echo "ğŸ“‚ æºç›®å½•: $source_dir"  
    echo "ğŸ”¢ æœ€å¤§å¹¶å‘: $MAX_JOBS"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    
    # è·å–æ–‡ä»¶åˆ—è¡¨
    local files=($(find "$source_dir" -type f -name "*.log" -o -name "*.txt"))
    local total_files=${#files[@]}
    
    echo "ğŸ“Š å‘ç° $total_files ä¸ªæ–‡ä»¶å¾…å¤„ç†"
    
    local start_time=$(date +%s)
    
    # å¤„ç†æ¯ä¸ªæ–‡ä»¶
    for file in "${files[@]}"; do
        # å¦‚æœè¾¾åˆ°æœ€å¤§å¹¶å‘æ•°ï¼Œç­‰å¾…ä¸€ä¸ªä½œä¸šå®Œæˆ
        while [ $ACTIVE_JOBS -ge $MAX_JOBS ]; do
            echo "ğŸ”„ è¾¾åˆ°æœ€å¤§å¹¶å‘æ•°($MAX_JOBS)ï¼Œç­‰å¾…ä½œä¸šå®Œæˆ..."
            wait_for_job_completion
            sleep 1
        done
        
        # å¯åŠ¨æ–°çš„å‹ç¼©ä½œä¸š
        start_compress_job "$file"
    done
    
    # ç­‰å¾…æ‰€æœ‰å‰©ä½™ä½œä¸šå®Œæˆ
    echo "â³ ç­‰å¾…æ‰€æœ‰å‰©ä½™ä½œä¸šå®Œæˆ..."
    wait_for_job_completion
    
    # æœ€ç»ˆç»Ÿè®¡
    local end_time=$(date +%s)
    local total_duration=$((end_time - start_time))
    
    echo ""
    echo "ğŸ å¹¶è¡Œå‹ç¼©å®Œæˆ!"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“Š æœ€ç»ˆç»Ÿè®¡:"
    echo "   ğŸ“ æ€»æ–‡ä»¶æ•°: $total_files"
    echo "   âœ… æˆåŠŸ: $COMPLETED_JOBS"
    echo "   âŒ å¤±è´¥: $FAILED_JOBS"
    echo "   â±ï¸  æ€»è€—æ—¶: $(date -d@$total_duration -u +%H:%M:%S)"
    echo "   ğŸ“ˆ å¹³å‡é€Ÿåº¦: $(echo "scale=2; $total_files / $total_duration" | bc -l) æ–‡ä»¶/ç§’"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    
    # æ¸…ç†ä¸´æ—¶æ—¥å¿—æ–‡ä»¶
    rm -f /tmp/compress_job_*.log
}
```

> ğŸ’¡ **å¹¶è¡Œä¼˜åŒ–æç¤º**ï¼šå¹¶å‘æ•°ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°çš„1-2å€ã€‚å¤ªå¤šå¹¶å‘ä¼šå¯¼è‡´ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œåè€Œé™ä½æ•ˆç‡ã€‚å¯ä»¥ç”¨`nproc`å‘½ä»¤æŸ¥çœ‹CPUæ ¸å¿ƒæ•°ã€‚

---

## 9. ğŸ› ï¸ é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ¢å¤


### 9.1 å¸¸è§å‹ç¼©é”™è¯¯ç±»å‹


**é€šä¿—ç†è§£**ï¼šå‹ç¼©è¿‡ç¨‹ä¸­ä¼šé‡åˆ°å„ç§é—®é¢˜ï¼Œå°±åƒåšèœæ—¶å¯èƒ½æ²¡ç›ã€ç«å€™ä¸å¤Ÿã€é”…å­åäº†ç­‰ç­‰ã€‚æˆ‘ä»¬éœ€è¦é¢„å…ˆæƒ³å¥½è¿™äº›æƒ…å†µè¯¥æ€ä¹ˆå¤„ç†ï¼Œè®©è„šæœ¬æ›´ç¨³å®šå¯é ã€‚

**å¸¸è§é”™è¯¯åˆ†ç±»**ï¼š
```
ğŸ”¸ æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ï¼š
â€¢ ç£ç›˜ç©ºé—´ä¸è¶³
â€¢ æ–‡ä»¶æƒé™ä¸å¤Ÿ
â€¢ æ–‡ä»¶æ­£åœ¨è¢«ä½¿ç”¨
â€¢ è·¯å¾„ä¸å­˜åœ¨

ğŸ”¸ ç³»ç»Ÿèµ„æºé”™è¯¯ï¼š
â€¢ å†…å­˜ä¸è¶³
â€¢ CPUè´Ÿè½½è¿‡é«˜
â€¢ æ–‡ä»¶æè¿°ç¬¦ç”¨å®Œ

ğŸ”¸ å‹ç¼©å·¥å…·é”™è¯¯ï¼š
â€¢ å‹ç¼©å·¥å…·æœªå®‰è£…
â€¢ æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
â€¢ å‹ç¼©è¿‡ç¨‹ä¸­æ–­

ğŸ”¸ ç½‘ç»œç›¸å…³é”™è¯¯ï¼š
â€¢ é‚®ä»¶å‘é€å¤±è´¥
â€¢ è¿œç¨‹å­˜å‚¨ä¸å¯è¾¾
```

### 9.2 é”™è¯¯æ£€æµ‹ä¸å¤„ç†æœºåˆ¶


**ğŸ’» å…¨é¢é”™è¯¯å¤„ç†æ¡†æ¶**
```bash
#!/bin/bash
# é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ¢å¤æ¡†æ¶

# é”™è¯¯ä»£ç å®šä¹‰
readonly ERROR_DISK_FULL=101
readonly ERROR_PERMISSION=102
readonly ERROR_FILE_IN_USE=103
readonly ERROR_TOOL_MISSING=104
readonly ERROR_MEMORY=105
readonly ERROR_TIMEOUT=106

# è®¾ç½®é”™è¯¯å¤„ç†
set -eE  # å‡ºé”™æ—¶é€€å‡ºï¼ŒåŒ…æ‹¬å­shell
trap 'handle_error $? $LINENO' ERR

# é”™è¯¯å¤„ç†å‡½æ•°
handle_error() {
    local exit_code=$1
    local line_number=$2
    local command="${BASH_COMMAND}"
    
    write_log "ERROR" "è„šæœ¬æ‰§è¡Œå‡ºé”™ - è¡Œå·: $line_number, å‘½ä»¤: $command, é€€å‡ºç : $exit_code" "ERROR_HANDLER"
    
    # æ ¹æ®é”™è¯¯ç è¿›è¡Œä¸åŒå¤„ç†
    case $exit_code in
        $ERROR_DISK_FULL)
            handle_disk_full_error
            ;;
        $ERROR_PERMISSION)
            handle_permission_error
            ;;
        $ERROR_FILE_IN_USE)
            handle_file_in_use_error
            ;;
        *)
            handle_general_error "$exit_code" "$line_number"
            ;;
    esac
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    cleanup_temp_files
    
    # å‘é€é”™è¯¯é€šçŸ¥
    send_error_notification "$exit_code" "$line_number" "$command"
}

# é¢„æ£€æŸ¥å‡½æ•°
pre_check() {
    local file="$1"
    local target_dir="$2"
    
    echo "ğŸ” æ‰§è¡Œé¢„æ£€æŸ¥..."
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨å’Œå¯è¯»
    if [ ! -f "$file" ]; then
        write_log "ERROR" "æ–‡ä»¶ä¸å­˜åœ¨: $file" "PRECHECK"
        return $ERROR_PERMISSION
    fi
    
    if [ ! -r "$file" ]; then
        write_log "ERROR" "æ–‡ä»¶æ— è¯»æƒé™: $file" "PRECHECK"
        return $ERROR_PERMISSION
    fi
    
    # æ£€æŸ¥ç›®æ ‡ç›®å½•æƒé™
    if [ ! -w "$target_dir" ]; then
        write_log "ERROR" "ç›®æ ‡ç›®å½•æ— å†™æƒé™: $target_dir" "PRECHECK"
        return $ERROR_PERMISSION
    fi
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    local file_size=$(stat -c%s "$file")
    local available_space=$(df "$target_dir" | awk 'NR==2 {print $4*1024}')
    
    if [ $file_size -gt $available_space ]; then
        write_log "ERROR" "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œéœ€è¦: $(numfmt --to=iec $file_size), å¯ç”¨: $(numfmt --to=iec $available_space)" "PRECHECK"
        return $ERROR_DISK_FULL
    fi
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«å ç”¨
    if lsof "$file" >/dev/null 2>&1; then
        write_log "WARN" "æ–‡ä»¶è¢«å…¶ä»–è¿›ç¨‹å ç”¨: $file" "PRECHECK"
        return $ERROR_FILE_IN_USE
    fi
    
    # æ£€æŸ¥å‹ç¼©å·¥å…·
    local tools=("gzip" "bzip2" "xz")
    for tool in "${tools[@]}"; do
        if ! command -v "$tool" >/dev/null 2>&1; then
            write_log "ERROR" "å‹ç¼©å·¥å…·æœªå®‰è£…: $tool" "PRECHECK"
            return $ERROR_TOOL_MISSING
        fi
    done
    
    echo "âœ… é¢„æ£€æŸ¥é€šè¿‡"
    return 0
}
```

### 9.3 å¼‚å¸¸æƒ…å†µæ¢å¤ç­–ç•¥


**ğŸ’» æ™ºèƒ½æ¢å¤æœºåˆ¶**
```bash
# ç£ç›˜ç©ºé—´ä¸è¶³å¤„ç†
handle_disk_full_error() {
    write_log "WARN" "æ£€æµ‹åˆ°ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå°è¯•æ¸…ç†ä¸´æ—¶æ–‡ä»¶" "RECOVERY"
    
    # æ¸…ç†ä¸´æ—¶ç›®å½•
    find /tmp -type f -name "*.tmp" -mtime +1 -delete 2>/dev/null || true
    find /var/tmp -type f -mtime +7 -delete 2>/dev/null || true
    
    # æ¸…ç†æ—§çš„å‹ç¼©æ–‡ä»¶
    find /var/log/archive -name "*.gz" -mtime +30 -delete 2>/dev/null || true
    
    # å†æ¬¡æ£€æŸ¥ç©ºé—´
    local available_space=$(df /var/log | awk 'NR==2 {print $4*1024}')
    if [ $available_space -gt 1073741824 ]; then  # >1GB
        write_log "INFO" "æ¸…ç†åæœ‰è¶³å¤Ÿç©ºé—´ï¼Œç»§ç»­æ‰§è¡Œ" "RECOVERY"
        return 0
    else
        write_log "ERROR" "æ¸…ç†åä»ç„¶ç©ºé—´ä¸è¶³ï¼Œæš‚åœä»»åŠ¡" "RECOVERY"
        return 1
    fi
}

# æƒé™é”™è¯¯å¤„ç†
handle_permission_error() {
    write_log "WARN" "æ£€æµ‹åˆ°æƒé™é”™è¯¯ï¼Œå°è¯•ä¿®å¤" "RECOVERY"
    
    # æ£€æŸ¥æ˜¯å¦ä¸ºsudoç”¨æˆ·
    if [ "$EUID" -eq 0 ] || groups | grep -q sudo; then
        write_log "INFO" "å½“å‰ç”¨æˆ·æœ‰ç®¡ç†å‘˜æƒé™ï¼Œå°è¯•ä¿®å¤æƒé™" "RECOVERY"
        
        # ä¿®å¤å¸¸è§ç›®å½•æƒé™
        chmod 755 /var/log/archive 2>/dev/null || true
        chown $(whoami):$(whoami) /var/log/archive 2>/dev/null || true
        
        return 0
    else
        write_log "ERROR" "æ— è¶³å¤Ÿæƒé™ä¿®å¤ï¼Œè¯·è”ç³»ç®¡ç†å‘˜" "RECOVERY"
        return 1
    fi
}

# æ–‡ä»¶å ç”¨å¤„ç†
handle_file_in_use_error() {
    local file="$1"
    local max_wait=300  # æœ€å¤šç­‰å¾…5åˆ†é’Ÿ
    local wait_time=0
    
    write_log "WARN" "æ–‡ä»¶è¢«å ç”¨ï¼Œç­‰å¾…é‡Šæ”¾: $file" "RECOVERY"
    
    while [ $wait_time -lt $max_wait ]; do
        if ! lsof "$file" >/dev/null 2>&1; then
            write_log "INFO" "æ–‡ä»¶å·²é‡Šæ”¾ï¼Œç»§ç»­å¤„ç†" "RECOVERY"
            return 0
        fi
        
        echo "â³ ç­‰å¾…æ–‡ä»¶é‡Šæ”¾... ($wait_time/${max_wait}ç§’)"
        sleep 10
        wait_time=$((wait_time + 10))
    done
    
    write_log "ERROR" "æ–‡ä»¶ç­‰å¾…è¶…æ—¶ï¼Œè·³è¿‡å¤„ç†: $file" "RECOVERY"
    return 1
}

# é€šç”¨é”™è¯¯å¤„ç†
handle_general_error() {
    local exit_code="$1"
    local line_number="$2"
    
    write_log "ERROR" "æœªé¢„æœŸçš„é”™è¯¯ - é€€å‡ºç : $exit_code, è¡Œå·: $line_number" "RECOVERY"
    
    # åˆ›å»ºé”™è¯¯å¿«ç…§
    create_error_snapshot "$exit_code" "$line_number"
    
    # å°è¯•é‡å¯è„šæœ¬ï¼ˆæœ€å¤š3æ¬¡ï¼‰
    if [ "${ERROR_RETRY_COUNT:-0}" -lt 3 ]; then
        export ERROR_RETRY_COUNT=$((${ERROR_RETRY_COUNT:-0} + 1))
        write_log "INFO" "å°è¯•é‡å¯è„šæœ¬ï¼Œé‡è¯•æ¬¡æ•°: $ERROR_RETRY_COUNT" "RECOVERY"
        sleep 30
        exec "$0" "$@"  # é‡æ–°æ‰§è¡Œè„šæœ¬
    else
        write_log "ERROR" "é‡è¯•æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œåœæ­¢æ‰§è¡Œ" "RECOVERY"
        return 1
    fi
}
```

### 9.4 æ•…éšœæ¢å¤å’Œé‡è¯•æœºåˆ¶


**ğŸ’» æ™ºèƒ½é‡è¯•ç­–ç•¥**
```bash
# å¸¦é‡è¯•çš„å‹ç¼©å‡½æ•°
compress_with_retry() {
    local file="$1"
    local compress_type="$2"
    local max_retries="${3:-3}"
    local retry_count=0
    
    while [ $retry_count -lt $max_retries ]; do
        write_log "INFO" "å‹ç¼©å°è¯• $((retry_count + 1))/$max_retries: $file" "RETRY"
        
        # æ‰§è¡Œé¢„æ£€æŸ¥
        if ! pre_check "$file" "$(dirname "$file")"; then
            local check_result=$?
            write_log "WARN" "é¢„æ£€æŸ¥å¤±è´¥ï¼Œé”™è¯¯ç : $check_result" "RETRY"
            
            # æ ¹æ®é”™è¯¯ç±»å‹å†³å®šæ˜¯å¦é‡è¯•
            case $check_result in
                $ERROR_DISK_FULL|$ERROR_FILE_IN_USE)
                    write_log "INFO" "å¯æ¢å¤é”™è¯¯ï¼Œç­‰å¾…åé‡è¯•" "RETRY"
                    sleep $((retry_count * 30))  # é€’å¢ç­‰å¾…æ—¶é—´
                    ;;
                $ERROR_PERMISSION|$ERROR_TOOL_MISSING)
                    write_log "ERROR" "ä¸å¯æ¢å¤é”™è¯¯ï¼Œåœæ­¢é‡è¯•" "RETRY"
                    return $check_result
                    ;;
            esac
        else
            # é¢„æ£€æŸ¥é€šè¿‡ï¼Œå°è¯•å‹ç¼©
            case "$compress_type" in
                "gzip")
                    if timeout 600 gzip -9 "$file"; then  # 10åˆ†é’Ÿè¶…æ—¶
                        write_log "INFO" "å‹ç¼©æˆåŠŸ: $file" "RETRY"
                        return 0
                    fi
                    ;;
                "bzip2")
                    if timeout 1200 bzip2 -9 "$file"; then  # 20åˆ†é’Ÿè¶…æ—¶
                        write_log "INFO" "å‹ç¼©æˆåŠŸ: $file" "RETRY"
                        return 0
                    fi
                    ;;
                "xz")
                    if timeout 1800 xz -9 "$file"; then  # 30åˆ†é’Ÿè¶…æ—¶
                        write_log "INFO" "å‹ç¼©æˆåŠŸ: $file" "RETRY"
                        return 0
                    fi
                    ;;
            esac
        fi
        
        ((retry_count++))
        
        if [ $retry_count -lt $max_retries ]; then
            local wait_time=$((retry_count * 60))  # é€’å¢ç­‰å¾…ï¼š1åˆ†é’Ÿã€2åˆ†é’Ÿã€3åˆ†é’Ÿ
            write_log "WARN" "å‹ç¼©å¤±è´¥ï¼Œç­‰å¾… ${wait_time}ç§’åé‡è¯•" "RETRY"
            sleep $wait_time
        fi
    done
    
    write_log "ERROR" "å‹ç¼©æœ€ç»ˆå¤±è´¥ï¼Œå·²é‡è¯• $max_retries æ¬¡: $file" "RETRY"
    return 1
}

# ä»»åŠ¡æ¢å¤æœºåˆ¶
create_recovery_point() {
    local task_name="$1"
    local current_file="$2"
    local processed_count="$3"
    
    local recovery_file="/var/log/compression/${task_name}_recovery.state"
    
    cat > "$recovery_file" << EOF
TASK_NAME="$task_name"
CURRENT_FILE="$current_file" 
PROCESSED_COUNT="$processed_count"
TIMESTAMP="$(date +%s)"
PID="$"
EOF

    write_log "INFO" "åˆ›å»ºæ¢å¤ç‚¹: $recovery_file" "RECOVERY"
}

# ä»æ¢å¤ç‚¹ç»§ç»­
resume_from_recovery() {
    local recovery_file="$1"
    
    if [ -f "$recovery_file" ]; then
        write_log "INFO" "å‘ç°æ¢å¤ç‚¹ï¼Œå°è¯•ä»ä¸­æ–­å¤„ç»§ç»­" "RECOVERY"
        
        # åŠ è½½æ¢å¤ä¿¡æ¯
        source "$recovery_file"
        
        # æ£€æŸ¥æ¢å¤ç‚¹çš„æœ‰æ•ˆæ€§
        local recovery_age=$(( $(date +%s) - TIMESTAMP ))
        
        if [ $recovery_age -gt 86400 ]; then  # è¶…è¿‡24å°æ—¶çš„æ¢å¤ç‚¹å¿½ç•¥
            write_log "WARN" "æ¢å¤ç‚¹è¿‡æ—§ï¼Œé‡æ–°å¼€å§‹ä»»åŠ¡" "RECOVERY"
            rm -f "$recovery_file"
            return 1
        fi
        
        # æ£€æŸ¥è¿›ç¨‹æ˜¯å¦ä»åœ¨è¿è¡Œ
        if kill -0 "$PID" 2>/dev/null; then
            write_log "WARN" "æ£€æµ‹åˆ°ä»»åŠ¡ä»åœ¨è¿è¡Œï¼Œé¿å…é‡å¤æ‰§è¡Œ" "RECOVERY"
            return 1
        fi
        
        write_log "INFO" "ä»æ¢å¤ç‚¹ç»§ç»­ï¼šä»»åŠ¡=$TASK_NAME, å·²å¤„ç†=$PROCESSED_COUNT" "RECOVERY"
        
        # è¿”å›æ¢å¤ä¿¡æ¯
        export RESUME_TASK_NAME="$TASK_NAME"
        export RESUME_CURRENT_FILE="$CURRENT_FILE"
        export RESUME_PROCESSED_COUNT="$PROCESSED_COUNT"
        
        return 0
    else
        write_log "INFO" "æœªå‘ç°æ¢å¤ç‚¹ï¼Œä»å¤´å¼€å§‹ä»»åŠ¡" "RECOVERY"
        return 1
    fi
}
```

### 9.5 é”™è¯¯é€šçŸ¥å’ŒæŠ¥è­¦


**ğŸ’» å®Œæ•´çš„é”™è¯¯é€šçŸ¥ç³»ç»Ÿ**
```bash
# å‘é€é”™è¯¯é€šçŸ¥
send_error_notification() {
    local exit_code="$1"
    local line_number="$2"
    local command="$3"
    
    local error_level="ERROR"
    local urgency="high"
    
    # æ ¹æ®é”™è¯¯ç±»å‹ç¡®å®šé€šçŸ¥çº§åˆ«
    case $exit_code in
        $ERROR_DISK_FULL)
            error_level="CRITICAL"
            urgency="high"
            ;;
        $ERROR_PERMISSION)
            error_level="WARNING"  
            urgency="normal"
            ;;
        $ERROR_FILE_IN_USE)
            error_level="INFO"
            urgency="low"
            ;;
    esac
    
    # æ”¶é›†ç³»ç»Ÿä¿¡æ¯
    local system_info="
    <h4>ğŸ–¥ï¸ ç³»ç»Ÿä¿¡æ¯</h4>
    <ul>
        <li><strong>ä¸»æœºå:</strong> $(hostname)</li>
        <li><strong>æ—¶é—´:</strong> $(date '+%Y-%m-%d %H:%M:%S')</li>
        <li><strong>ç”¨æˆ·:</strong> $(whoami)</li>
        <li><strong>è¿›ç¨‹ID:</strong> $</li>
        <li><strong>å·¥ä½œç›®å½•:</strong> $(pwd)</li>
    </ul>
    
    <h4>âŒ é”™è¯¯è¯¦æƒ…</h4>
    <ul>
        <li><strong>é”™è¯¯ç :</strong> $exit_code</li>
        <li><strong>å‡ºé”™è¡Œå·:</strong> $line_number</li>
        <li><strong>å‡ºé”™å‘½ä»¤:</strong> <code>$command</code></li>
    </ul>
    
    <h4>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h4>
    <ul>
        <li><strong>CPUè´Ÿè½½:</strong> $(uptime | awk '{print $10,$11,$12}')</li>
        <li><strong>å†…å­˜ä½¿ç”¨:</strong> $(free -h | awk '/^Mem:/{print $3"/"$2}')</li>
        <li><strong>ç£ç›˜ä½¿ç”¨:</strong> $(df -h /var/log | awk 'NR==2{print $3"/"$2" ("$5")"}')</li>
    </ul>
    "
    
    # æ·»åŠ æ¢å¤å»ºè®®
    local recovery_suggestion=""
    case $exit_code in
        $ERROR_DISK_FULL)
            recovery_suggestion="ğŸ’¡ <strong>å»ºè®®:</strong> æ¸…ç†ç£ç›˜ç©ºé—´æˆ–å¢åŠ å­˜å‚¨å®¹é‡"
            ;;
        $ERROR_PERMISSION)
            recovery_suggestion="ğŸ’¡ <strong>å»ºè®®:</strong> æ£€æŸ¥æ–‡ä»¶æƒé™æˆ–ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·"
            ;;
        $ERROR_TOOL_MISSING)
            recovery_suggestion="ğŸ’¡ <strong>å»ºè®®:</strong> å®‰è£…ç¼ºå¤±çš„å‹ç¼©å·¥å…·"
            ;;
    esac
    
    local complete_message="$system_info$recovery_suggestion"
    
    # å‘é€é€šçŸ¥
    send_notification "[$error_level] å‹ç¼©è„šæœ¬æ‰§è¡Œå¼‚å¸¸" "$complete_message" "$urgency"
}

# åˆ›å»ºé”™è¯¯å¿«ç…§
create_error_snapshot() {
    local exit_code="$1"
    local line_number="$2"
    local snapshot_dir="/var/log/compression/snapshots"
    local snapshot_file="$snapshot_dir/error_$(date +%Y%m%d_%H%M%S).log"
    
    mkdir -p "$snapshot_dir"
    
    {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "é”™è¯¯å¿«ç…§ - $(date '+%Y-%m-%d %H:%M:%S')"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "é”™è¯¯ç : $exit_code"
        echo "å‡ºé”™è¡Œå·: $line_number"
        echo "æ‰§è¡Œå‘½ä»¤: $BASH_COMMAND"
        echo "è„šæœ¬è·¯å¾„: $0"
        echo "å‚æ•°åˆ—è¡¨: $*"
        echo ""
        echo "ç³»ç»Ÿç¯å¢ƒ:"
        env | grep -E "(PATH|USER|HOME|PWD)" | sort
        echo ""
        echo "è¿›ç¨‹çŠ¶æ€:"
        ps aux | grep -E "(compress|gzip|bzip|xz)" | head -10
        echo ""
        echo "ç£ç›˜ä½¿ç”¨:"
        df -h
        echo ""
        echo "å†…å­˜ä½¿ç”¨:"
        free -h
        echo ""
        echo "æœ€è¿‘æ—¥å¿—:"
        tail -n 20 "$LOG_FILE" 2>/dev/null || echo "æ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    } > "$snapshot_file"
    
    write_log "INFO" "é”™è¯¯å¿«ç…§å·²ä¿å­˜: $snapshot_file" "SNAPSHOT"
}

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
cleanup_temp_files() {
    write_log "INFO" "æ¸…ç†ä¸´æ—¶æ–‡ä»¶" "CLEANUP"
    
    # æ¸…ç†æœ¬æ¬¡è„šæœ¬äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶
    find /tmp -name "compress_job_*.log" -user "$(whoami)" -delete 2>/dev/null || true
    find /tmp -name "mail_content_*" -user "$(whoami)" -delete 2>/dev/null || true
    find /tmp -name "audit_analysis_*" -user "$(whoami)" -delete 2>/dev/null || true
    
    # æ¸…ç†è¿‡æœŸçš„æ¢å¤ç‚¹æ–‡ä»¶
    find /var/log/compression -name "*_recovery.state" -mtime +7 -delete 2>/dev/null || true
    
    write_log "INFO" "ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ" "CLEANUP"
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è‡ªåŠ¨åŒ–å‹ç¼©æœ¬è´¨ï¼šè®©æœºå™¨åƒäººä¸€æ ·æ€è€ƒï¼Œè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å‹ç¼©ç­–ç•¥
ğŸ”¸ æ™ºèƒ½ç­–ç•¥é€‰æ‹©ï¼šæ ¹æ®æ–‡ä»¶å¤§å°ã€ç±»å‹ã€ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´å‹ç¼©æ–¹æ³•
ğŸ”¸ å®šæ—¶ä»»åŠ¡é…ç½®ï¼šä½¿ç”¨cronè®¾ç½®å®šæœŸå‹ç¼©ï¼Œå®ç°æ— äººå€¼å®ˆæ“ä½œ
ğŸ”¸ è¿›åº¦ç›‘æ§æ˜¾ç¤ºï¼šå®æ—¶äº†è§£å‹ç¼©è¿›åº¦ï¼Œé¿å…ç­‰å¾…ç„¦è™‘
ğŸ”¸ é‚®ä»¶é€šçŸ¥é›†æˆï¼šåŠæ—¶è·çŸ¥ä»»åŠ¡ç»“æœï¼Œç‰¹åˆ«æ˜¯å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µ
ğŸ”¸ æ—¥å¿—è®°å½•å®¡è®¡ï¼šè¯¦ç»†è®°å½•å‹ç¼©è¿‡ç¨‹ï¼Œä¾¿äºæ•…éšœæ’æŸ¥å’Œæ•ˆæœåˆ†æ
ğŸ”¸ å¹¶è¡Œå¤„ç†ä¼˜åŒ–ï¼šåˆ©ç”¨å¤šæ ¸CPUä¼˜åŠ¿ï¼Œå¤§å¹…æå‡å‹ç¼©æ•ˆç‡
ğŸ”¸ é”™è¯¯å¤„ç†æ¢å¤ï¼šé¢„è§å¹¶å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼Œç¡®ä¿è„šæœ¬ç¨³å®šè¿è¡Œ
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨åŒ–å‹ç¼©è„šæœ¬**
```
æ‰‹åŠ¨å‹ç¼©çš„é—®é¢˜ï¼š
â€¢ é‡å¤æ€§å·¥ä½œå®¹æ˜“é—å¿˜
â€¢ ä¸çŸ¥é“ç”¨å“ªç§å‹ç¼©å·¥å…·æœ€å¥½  
â€¢ å¤§æ–‡ä»¶å‹ç¼©æ—¶é—´é•¿ï¼Œéœ€è¦äººå·¥ç­‰å¾…
â€¢ æ— æ³•åŠæ—¶äº†è§£å‹ç¼©ç»“æœ

è‡ªåŠ¨åŒ–è„šæœ¬çš„ä»·å€¼ï¼š
â€¢ è§£æ”¾äººåŠ›ï¼Œé¿å…é‡å¤åŠ³åŠ¨
â€¢ æ™ºèƒ½å†³ç­–ï¼Œé€‰æ‹©æœ€ä¼˜ç­–ç•¥
â€¢ æ— äººå€¼å®ˆï¼Œå®šæ—¶è‡ªåŠ¨æ‰§è¡Œ
â€¢ å…¨ç¨‹ç›‘æ§ï¼Œå¼‚å¸¸åŠæ—¶é€šçŸ¥
```

**ğŸ”¹ æ™ºèƒ½ç­–ç•¥é€‰æ‹©çš„æ ¸å¿ƒæ€è·¯**
```
å°±åƒåŒ»ç”Ÿçœ‹ç—…è¦å¯¹ç—‡ä¸‹è¯ï¼š

å°æ–‡ä»¶(<1MB)ï¼š
â€¢ ç‰¹ç‚¹ï¼šæ•°é‡å¤šï¼Œå•ä¸ªå°
â€¢ ç­–ç•¥ï¼šgzipå¿«é€Ÿå¤„ç†
â€¢ åŸå› ï¼šé€Ÿåº¦ä¼˜å…ˆï¼ŒCPUå ç”¨ä½

ä¸­ç­‰æ–‡ä»¶(1-50MB)ï¼š
â€¢ ç‰¹ç‚¹ï¼šå¤§å°é€‚ä¸­
â€¢ ç­–ç•¥ï¼šbzip2å¹³è¡¡å¤„ç†
â€¢ åŸå› ï¼šå‹ç¼©ç‡å’Œé€Ÿåº¦å…¼é¡¾

å¤§æ–‡ä»¶(>50MB)ï¼š
â€¢ ç‰¹ç‚¹ï¼šå ç”¨ç©ºé—´å¤§
â€¢ ç­–ç•¥ï¼šxzé«˜æ•ˆå‹ç¼©
â€¢ åŸå› ï¼šå‹ç¼©ç‡ä¼˜å…ˆï¼ŒèŠ‚çœå­˜å‚¨
```

**ğŸ”¹ å¹¶è¡Œå¤„ç†çš„ä¼˜åŠ¿å’Œæ³¨æ„äº‹é¡¹**
```
å¹¶è¡Œå¤„ç†ä¼˜åŠ¿ï¼š
â€¢ å……åˆ†åˆ©ç”¨å¤šæ ¸CPU
â€¢ å¤§å¹…ç¼©çŸ­æ€»ä½“å¤„ç†æ—¶é—´
â€¢ æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡

æ³¨æ„äº‹é¡¹ï¼š
â€¢ å¹¶å‘æ•°ä¸æ˜¯è¶Šå¤šè¶Šå¥½
â€¢ éœ€è¦è€ƒè™‘ç£ç›˜I/Oç“¶é¢ˆ
â€¢ è¦ç›‘æ§ç³»ç»Ÿè´Ÿè½½æƒ…å†µ
â€¢ å¤§æ–‡ä»¶å‹ç¼©æ—¶å†…å­˜æ¶ˆè€—å¤§
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ è„šæœ¬éƒ¨ç½²å»ºè®®**
```
ç¯å¢ƒå‡†å¤‡ï¼š
âœ“ ç¡®ä¿å®‰è£…äº†æ‰€éœ€å‹ç¼©å·¥å…·(gzip/bzip2/xz)
âœ“ é…ç½®é‚®ä»¶å‘é€åŠŸèƒ½(mutt/sendmail)
âœ“ åˆ›å»ºå¿…è¦çš„ç›®å½•å’Œæ—¥å¿—æ–‡ä»¶
âœ“ è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™

å®šæ—¶ä»»åŠ¡è®¾ç½®ï¼š
â€¢ æ—¥å¿—å‹ç¼©ï¼šæ¯å¤©å‡Œæ™¨æ‰§è¡Œ
â€¢ æ•°æ®å¤‡ä»½ï¼šæ¯å‘¨æœ«æ‰§è¡Œ  
â€¢ ä¸´æ—¶æ–‡ä»¶æ¸…ç†ï¼šæ¯å‡ å°æ—¶æ‰§è¡Œ
â€¢ æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´æ—¶é—´

ç›‘æ§æŒ‡æ ‡ï¼š
â€¢ å‹ç¼©æˆåŠŸç‡å’Œå¤±è´¥ç‡
â€¢ å¹³å‡å‹ç¼©ç‡å’ŒèŠ‚çœç©ºé—´
â€¢ è„šæœ¬æ‰§è¡Œæ—¶é—´å’Œç³»ç»Ÿè´Ÿè½½
â€¢ é‚®ä»¶é€šçŸ¥çš„åŠæ—¶æ€§
```

**ğŸ”§ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
```
æ–‡ä»¶å¤„ç†ä¼˜åŒ–ï¼š
â€¢ æŒ‰æ–‡ä»¶å¤§å°åˆ†æ‰¹å¤„ç†
â€¢ å¤§æ–‡ä»¶å•ç‹¬å¤„ç†ï¼Œå°æ–‡ä»¶æ‰¹é‡å¤„ç†
â€¢ ä½¿ç”¨åˆé€‚çš„å¹¶å‘æ•°é‡

ç³»ç»Ÿèµ„æºä¼˜åŒ–ï¼š
â€¢ ç›‘æ§CPUå’Œå†…å­˜ä½¿ç”¨ç‡
â€¢ åœ¨ç³»ç»Ÿç©ºé—²æ—¶æ‰§è¡Œé‡ä»»åŠ¡
â€¢ è®¾ç½®è¶…æ—¶é˜²æ­¢è¿›ç¨‹å¡æ­»

å­˜å‚¨ç©ºé—´ä¼˜åŒ–ï¼š
â€¢ å®šæœŸæ¸…ç†æ—§çš„å‹ç¼©æ–‡ä»¶
â€¢ è®¾ç½®å‹ç¼©æ–‡ä»¶ä¿ç•™ç­–ç•¥
â€¢ ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
```

**ğŸ› ï¸ æ•…éšœæ’æŸ¥æŒ‡å—**
```
å¸¸è§é—®é¢˜åŠè§£å†³ï¼š

å‹ç¼©å¤±è´¥ï¼š
1. æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
2. éªŒè¯æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤å‹ç¼©å·¥å…·æ˜¯å¦å¯ç”¨
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—äº†è§£å…·ä½“åŸå› 

é‚®ä»¶é€šçŸ¥ä¸å·¥ä½œï¼š
1. æ£€æŸ¥é‚®ä»¶å®¢æˆ·ç«¯é…ç½®
2. éªŒè¯SMTPæœåŠ¡å™¨è¿æ¥
3. ç¡®è®¤æ”¶ä»¶äººåœ°å€æ­£ç¡®
4. æŸ¥çœ‹é‚®ä»¶æœåŠ¡æ—¥å¿—

å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œï¼š
1. æ£€æŸ¥crontabé…ç½®è¯­æ³•
2. éªŒè¯è„šæœ¬è·¯å¾„å’Œæƒé™
3. ç¡®è®¤cronæœåŠ¡æ­£åœ¨è¿è¡Œ
4. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—/var/log/cron
```

### 10.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ“š è„šæœ¬å¼€å‘æœ€ä½³å®è·µ**
```
ä»£ç ç»„ç»‡ï¼š
â€¢ å‡½æ•°åŒ–è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œå¤ç”¨
â€¢ ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œé¿å…ç¡¬ç¼–ç 
â€¢ æ·»åŠ è¯¦ç»†æ³¨é‡Šï¼Œæ–¹ä¾¿åç»­ç»´æŠ¤

é”™è¯¯å¤„ç†ï¼š
â€¢ é¢„è§å„ç§å¯èƒ½çš„å¼‚å¸¸æƒ…å†µ
â€¢ è®¾è®¡åˆç†çš„é‡è¯•å’Œæ¢å¤æœºåˆ¶  
â€¢ è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

æ—¥å¿—è®°å½•ï¼š
â€¢ ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼å’Œçº§åˆ«
â€¢ åˆ†ç¦»æ™®é€šæ—¥å¿—å’Œé”™è¯¯æ—¥å¿—
â€¢ è®¾ç½®æ—¥å¿—è½®è½¬ï¼Œé˜²æ­¢æ–‡ä»¶è¿‡å¤§
```

**ğŸ” å®‰å…¨æ€§è€ƒè™‘**
```
æƒé™æ§åˆ¶ï¼š
â€¢ è„šæœ¬æ–‡ä»¶è®¾ç½®é€‚å½“æƒé™(755)
â€¢ æ—¥å¿—ç›®å½•é™åˆ¶è®¿é—®æƒé™
â€¢ é¿å…åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯

æ•°æ®å®‰å…¨ï¼š
â€¢ å‹ç¼©æ•æ„Ÿæ–‡ä»¶å‰è€ƒè™‘åŠ å¯†
â€¢ å®šæœŸå¤‡ä»½é‡è¦çš„å‹ç¼©æ–‡ä»¶
â€¢ ç›‘æ§å¼‚å¸¸çš„æ–‡ä»¶è®¿é—®è¡Œä¸º

ç½‘ç»œå®‰å…¨ï¼š
â€¢ é‚®ä»¶é€šçŸ¥ä½¿ç”¨åŠ å¯†ä¼ è¾“
â€¢ é™åˆ¶è„šæœ¬çš„ç½‘ç»œè®¿é—®æƒé™
â€¢ å®šæœŸæ›´æ–°ç›¸å…³è½¯ä»¶å’Œè¡¥ä¸
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è‡ªåŠ¨å‹ç¼©è§£æ”¾åŒæ‰‹ï¼Œæ™ºèƒ½ç­–ç•¥å› ææ–½æ•™
- å®šæ—¶æ‰§è¡Œæ— äººå€¼å®ˆï¼Œè¿›åº¦ç›‘æ§å¿ƒä¸­æœ‰æ•°
- é‚®ä»¶é€šçŸ¥åŠæ—¶æé†’ï¼Œæ—¥å¿—è®°å½•æœ‰æ®å¯æŸ¥  
- å¹¶è¡Œå¤„ç†æå‡æ•ˆç‡ï¼Œé”™è¯¯å¤„ç†ä¿è¯ç¨³å®š
- è„šæœ¬å¼€å‘é‡åœ¨å®ç”¨ï¼Œç›‘æ§ç»´æŠ¤ä¸å¯å¿½è§†

> ğŸ’¡ **æ€»ç»“æç¤º**ï¼šè‡ªåŠ¨åŒ–å‹ç¼©è„šæœ¬çš„æ ¸å¿ƒæ˜¯"è®©æœºå™¨åƒäººä¸€æ ·æ€è€ƒ"ã€‚é€šè¿‡æ™ºèƒ½çš„ç­–ç•¥é€‰æ‹©ã€å®Œå–„çš„é”™è¯¯å¤„ç†ã€è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªç¨³å®šå¯é çš„å‹ç¼©ç³»ç»Ÿï¼Œå¤§å¤§æå‡è¿ç»´æ•ˆç‡ã€‚