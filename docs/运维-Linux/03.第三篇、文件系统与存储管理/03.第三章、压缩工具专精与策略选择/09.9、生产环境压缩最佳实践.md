---
title: 9ã€ç”Ÿäº§ç¯å¢ƒå‹ç¼©æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [æ—¥å¿—æ–‡ä»¶è½®è½¬å‹ç¼©é…ç½®](#1-æ—¥å¿—æ–‡ä»¶è½®è½¬å‹ç¼©é…ç½®)
2. [ç³»ç»Ÿèµ„æºç›‘æ§ä¸‹çš„å‹ç¼©æ“ä½œ](#2-ç³»ç»Ÿèµ„æºç›‘æ§ä¸‹çš„å‹ç¼©æ“ä½œ)
3. [ç½‘ç»œå¸¦å®½é™åˆ¶ç¯å¢ƒå‹ç¼©ä¼ è¾“](#3-ç½‘ç»œå¸¦å®½é™åˆ¶ç¯å¢ƒå‹ç¼©ä¼ è¾“)
4. [å¤§è§„æ¨¡æ–‡ä»¶æ‰¹é‡å‹ç¼©ç®¡ç†](#4-å¤§è§„æ¨¡æ–‡ä»¶æ‰¹é‡å‹ç¼©ç®¡ç†)
5. [å‹ç¼©æ“ä½œçš„å¹¶å‘æ§åˆ¶ä¸é˜Ÿåˆ—ç®¡ç†](#5-å‹ç¼©æ“ä½œçš„å¹¶å‘æ§åˆ¶ä¸é˜Ÿåˆ—ç®¡ç†)
6. [ç”Ÿäº§ç³»ç»Ÿå‹ç¼©ä»»åŠ¡è°ƒåº¦ç­–ç•¥](#6-ç”Ÿäº§ç³»ç»Ÿå‹ç¼©ä»»åŠ¡è°ƒåº¦ç­–ç•¥)
7. [å‹ç¼©å¤±è´¥çš„é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶](#7-å‹ç¼©å¤±è´¥çš„é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶)
8. [å‹ç¼©å·¥å…·é€‰æ‹©çš„æ ‡å‡†åŒ–è§„èŒƒ](#8-å‹ç¼©å·¥å…·é€‰æ‹©çš„æ ‡å‡†åŒ–è§„èŒƒ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ æ—¥å¿—æ–‡ä»¶è½®è½¬å‹ç¼©é…ç½®


### 1.1 logrotateåŸºæœ¬åŸç†


> ğŸ’¡ **æ¦‚å¿µè§£é‡Š**ï¼šlogrotateæ˜¯Linuxç³»ç»Ÿè‡ªå¸¦çš„æ—¥å¿—è½®è½¬å·¥å…·ï¼Œå®ƒçš„ä½œç”¨æ˜¯å®šæœŸå‹ç¼©ã€ç§»åŠ¨æˆ–åˆ é™¤æ—§çš„æ—¥å¿—æ–‡ä»¶ï¼Œé˜²æ­¢æ—¥å¿—å æ»¡ç£ç›˜ç©ºé—´ã€‚

**å·¥ä½œæµç¨‹å›¾ç¤º**ï¼š
```
æ—¥å¿—å¢é•¿è¿‡ç¨‹ï¼š
app.log (å½“å‰) â†’ app.log.1 â†’ app.log.2.gz â†’ app.log.3.gz â†’ åˆ é™¤

è½®è½¬è§¦å‘æ¡ä»¶ï¼š
- æ–‡ä»¶å¤§å°è¾¾åˆ°è®¾å®šå€¼ (å¦‚100M)
- æ—¶é—´é—´éš”è¾¾åˆ°è®¾å®šå€¼ (å¦‚æ¯å¤©)
- æ‰‹åŠ¨æ‰§è¡Œè½®è½¬å‘½ä»¤
```

### 1.2 logrotateé…ç½®è¯¦è§£


**ä¸»é…ç½®æ–‡ä»¶ç»“æ„**ï¼š
```bash
# /etc/logrotate.conf - å…¨å±€é…ç½®
weekly          # é»˜è®¤æ¯å‘¨è½®è½¬
rotate 4        # ä¿ç•™4ä¸ªå†å²æ–‡ä»¶
create          # è½®è½¬ååˆ›å»ºæ–°çš„ç©ºæ—¥å¿—æ–‡ä»¶
compress        # å‹ç¼©å†å²æ—¥å¿—
```

**å…·ä½“åº”ç”¨é…ç½®ç¤ºä¾‹**ï¼š
```bash
# /etc/logrotate.d/myapp - åº”ç”¨ä¸“ç”¨é…ç½®
/var/log/myapp/*.log {
    daily                    # æ¯å¤©è½®è½¬
    rotate 30               # ä¿ç•™30å¤©çš„æ—¥å¿—
    compress                # å‹ç¼©æ—§æ—¥å¿—
    delaycompress           # å»¶è¿Ÿå‹ç¼©(ä¿ç•™æœ€è¿‘ä¸€ä»½æœªå‹ç¼©)
    missingok               # æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¸æŠ¥é”™
    notifempty              # ç©ºæ–‡ä»¶ä¸è½®è½¬
    create 644 myapp myapp  # åˆ›å»ºæ–°æ–‡ä»¶çš„æƒé™å’Œæ‰€æœ‰è€…
    postrotate              # è½®è½¬åæ‰§è¡Œçš„å‘½ä»¤
        systemctl reload myapp
    endscript
}
```

### 1.3 é«˜çº§å‹ç¼©é…ç½®ç­–ç•¥


**åˆ†å±‚å‹ç¼©ç­–ç•¥**ï¼š
```bash
/var/log/nginx/access.log {
    daily
    rotate 7
    compress
    delaycompress
    sharedscripts
    postrotate
        # ç¬¬1-7å¤©ï¼šgzipå‹ç¼©(å¿«é€Ÿ)
        find /var/log/nginx -name "access.log.*.gz" -mtime -7 | head -7
        
        # 8-30å¤©ï¼šè½¬æ¢ä¸ºxzå‹ç¼©(æ›´å°)
        find /var/log/nginx -name "access.log.*.gz" -mtime +7 -mtime -30 -exec sh -c '
            xz -9 "$1"
            rm "$1"
        ' _ {} \;
    endscript
}
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
> - `delaycompress` ç¡®ä¿åº”ç”¨ç¨‹åºèƒ½æ­£å¸¸å†™å…¥å½“å‰æ—¥å¿—
> - `sharedscripts` é¿å…å¤šä¸ªæ—¥å¿—æ–‡ä»¶é‡å¤æ‰§è¡Œè„šæœ¬
> - å‹ç¼©çº§åˆ«è¦å¹³è¡¡é€Ÿåº¦å’Œç©ºé—´å ç”¨

---

## 2. ğŸ“Š ç³»ç»Ÿèµ„æºç›‘æ§ä¸‹çš„å‹ç¼©æ“ä½œ


### 2.1 èµ„æºç›‘æ§çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§**ï¼š
- **CPUä½¿ç”¨ç‡**ï¼šå‹ç¼©æ˜¯CPUå¯†é›†å‹æ“ä½œï¼Œå¯èƒ½å½±å“ä¸šåŠ¡æœåŠ¡
- **å†…å­˜å ç”¨**ï¼šå¤§æ–‡ä»¶å‹ç¼©éœ€è¦è¾ƒå¤šå†…å­˜ç¼“å†²åŒº
- **ç£ç›˜I/O**ï¼šè¯»å†™æ“ä½œå¯èƒ½é€ æˆç£ç›˜ç“¶é¢ˆ
- **ç½‘ç»œå¸¦å®½**ï¼šå‹ç¼©ä¼ è¾“éœ€è¦å¹³è¡¡å‹ç¼©æ¯”å’Œä¼ è¾“æ—¶é—´

### 2.2 èµ„æºä½¿ç”¨æƒ…å†µç›‘æ§è„šæœ¬


**å®æ—¶ç›‘æ§å‹ç¼©è¿›ç¨‹èµ„æº**ï¼š
```bash
#!/bin/bash
# compress_monitor.sh - å‹ç¼©æ“ä½œèµ„æºç›‘æ§

monitor_compression() {
    local pid=$1
    local logfile="/var/log/compress_monitor.log"
    
    echo "[$(date)] å¼€å§‹ç›‘æ§è¿›ç¨‹ $pid" >> $logfile
    
    while kill -0 $pid 2>/dev/null; do
        # è·å–è¿›ç¨‹èµ„æºä¿¡æ¯
        local cpu=$(ps -p $pid -o %cpu --no-headers)
        local mem=$(ps -p $pid -o %mem --no-headers)
        local io_read=$(cat /proc/$pid/io | grep "read_bytes" | awk '{print $2}')
        local io_write=$(cat /proc/$pid/io | grep "write_bytes" | awk '{print $2}')
        
        # è·å–ç³»ç»Ÿè´Ÿè½½
        local load_avg=$(uptime | awk -F'load average:' '{print $2}' | cut -d',' -f1)
        
        echo "[$(date)] CPU: ${cpu}% MEM: ${mem}% LOAD: $load_avg IO_R: $io_read IO_W: $io_write" >> $logfile
        
        # å¦‚æœè´Ÿè½½è¿‡é«˜ï¼Œæš‚åœå‹ç¼©è¿›ç¨‹
        if (( $(echo "$load_avg > 4.0" | bc -l) )); then
            echo "[$(date)] ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œæš‚åœå‹ç¼©è¿›ç¨‹" >> $logfile
            kill -STOP $pid
            sleep 60  # ç­‰å¾…1åˆ†é’Ÿ
            kill -CONT $pid
        fi
        
        sleep 5
    done
    
    echo "[$(date)] è¿›ç¨‹ $pid ç›‘æ§ç»“æŸ" >> $logfile
}
```

### 2.3 è‡ªé€‚åº”å‹ç¼©ç­–ç•¥


**æ ¹æ®ç³»ç»Ÿè´Ÿè½½è°ƒæ•´å‹ç¼©å‚æ•°**ï¼š
```bash
#!/bin/bash
# adaptive_compress.sh - è‡ªé€‚åº”å‹ç¼©

adaptive_compress() {
    local file=$1
    local current_load=$(uptime | awk '{print $3}' | cut -d',' -f1)
    local cpu_cores=$(nproc)
    
    # æ ¹æ®è´Ÿè½½é€‰æ‹©å‹ç¼©ç­–ç•¥
    if (( $(echo "$current_load < $cpu_cores" | bc -l) )); then
        # ä½è´Ÿè½½ï¼šä½¿ç”¨é«˜å‹ç¼©æ¯”
        echo "ç³»ç»Ÿè´Ÿè½½è¾ƒä½ï¼Œä½¿ç”¨é«˜å‹ç¼©æ¯”"
        xz -9 -T $cpu_cores "$file"
    elif (( $(echo "$current_load < $(($cpu_cores * 2))" | bc -l) )); then
        # ä¸­ç­‰è´Ÿè½½ï¼šä½¿ç”¨å¹³è¡¡å‹ç¼©
        echo "ç³»ç»Ÿè´Ÿè½½ä¸­ç­‰ï¼Œä½¿ç”¨å¹³è¡¡å‹ç¼©"
        xz -6 -T $(($cpu_cores / 2)) "$file"
    else
        # é«˜è´Ÿè½½ï¼šä½¿ç”¨å¿«é€Ÿå‹ç¼©
        echo "ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ï¼Œä½¿ç”¨å¿«é€Ÿå‹ç¼©"
        gzip -1 "$file"
    fi
}
```

---

## 3. ğŸŒ ç½‘ç»œå¸¦å®½é™åˆ¶ç¯å¢ƒå‹ç¼©ä¼ è¾“


### 3.1 ç½‘ç»œç¯å¢ƒåˆ†æ


**ä¸åŒç½‘ç»œç¯å¢ƒçš„ç­–ç•¥é€‰æ‹©**ï¼š

| ç½‘ç»œç±»å‹ | å¸¦å®½ç‰¹ç‚¹ | **å‹ç¼©ç­–ç•¥** | **å·¥å…·é€‰æ‹©** |
|---------|----------|-------------|-------------|
| **å†…ç½‘é«˜é€Ÿ** | `1Gbps+` | `è½»å‹ç¼©å¿«ä¼ è¾“` | `gzip -1` |
| **äº’è”ç½‘æ ‡å‡†** | `100Mbps` | `å¹³è¡¡å‹ç¼©ä¼ è¾“` | `xz -6` |
| **ç§»åŠ¨ç½‘ç»œ** | `<50Mbps` | `é«˜å‹ç¼©æ…¢ä¼ è¾“` | `xz -9` |
| **å«æ˜Ÿé“¾è·¯** | `é«˜å»¶è¿Ÿä½å¸¦å®½` | `æé™å‹ç¼©` | `xz -9e` |

### 3.2 å‹ç¼©ä¼ è¾“è„šæœ¬å®ç°


**æ™ºèƒ½å‹ç¼©ä¼ è¾“å·¥å…·**ï¼š
```bash
#!/bin/bash
# smart_transfer.sh - æ™ºèƒ½å‹ç¼©ä¼ è¾“

smart_transfer() {
    local source_file=$1
    local target_host=$2
    local target_path=$3
    
    # æµ‹è¯•ç½‘ç»œå¸¦å®½
    echo "æ­£åœ¨æµ‹è¯•åˆ° $target_host çš„ç½‘ç»œé€Ÿåº¦..."
    local bandwidth=$(timeout 10 iperf3 -c $target_host -t 5 2>/dev/null | 
                     tail -3 | head -1 | awk '{print $(NF-1)}' | cut -d'M' -f1)
    
    if [[ -z "$bandwidth" ]]; then
        bandwidth=10  # é»˜è®¤å¸¦å®½å‡è®¾
    fi
    
    local file_size=$(stat -c%s "$source_file")
    local file_size_mb=$((file_size / 1024 / 1024))
    
    echo "æ–‡ä»¶å¤§å°: ${file_size_mb}MB, ç½‘ç»œå¸¦å®½: ${bandwidth}Mbps"
    
    # æ ¹æ®å¸¦å®½é€‰æ‹©å‹ç¼©ç­–ç•¥
    if (( $(echo "$bandwidth > 100" | bc -l) )); then
        # é«˜å¸¦å®½ï¼šè½»å‹ç¼©
        echo "ä½¿ç”¨è½»å‹ç¼©ç­–ç•¥ (gzip -1)"
        gzip -1 -c "$source_file" | ssh "$target_host" "cat > $target_path.gz && gunzip $target_path.gz"
    elif (( $(echo "$bandwidth > 30" | bc -l) )); then
        # ä¸­ç­‰å¸¦å®½ï¼šæ ‡å‡†å‹ç¼©
        echo "ä½¿ç”¨æ ‡å‡†å‹ç¼©ç­–ç•¥ (xz -6)"
        xz -6 -c "$source_file" | ssh "$target_host" "cat > $target_path.xz && unxz $target_path.xz"
    else
        # ä½å¸¦å®½ï¼šé«˜å‹ç¼©
        echo "ä½¿ç”¨é«˜å‹ç¼©ç­–ç•¥ (xz -9)"
        xz -9 -c "$source_file" | ssh "$target_host" "cat > $target_path.xz && unxz $target_path.xz"
    fi
    
    echo "ä¼ è¾“å®Œæˆ"
}
```

### 3.3 æ–­ç‚¹ç»­ä¼ å‹ç¼©ä¼ è¾“


**æ”¯æŒæ–­ç‚¹ç»­ä¼ çš„å‹ç¼©ä¼ è¾“**ï¼š
```bash
#!/bin/bash
# resume_compress_transfer.sh - æ–­ç‚¹ç»­ä¼ å‹ç¼©ä¼ è¾“

resume_transfer() {
    local source_file=$1
    local target_host=$2
    local target_path=$3
    local chunk_size="100M"  # åˆ†å—å¤§å°
    
    # åˆ›å»ºä¸´æ—¶ç›®å½•
    local temp_dir="/tmp/transfer_$(basename $source_file)_$$"
    mkdir -p "$temp_dir"
    
    # åˆ†å‰²æ–‡ä»¶
    echo "åˆ†å‰²æºæ–‡ä»¶..."
    split -b $chunk_size "$source_file" "$temp_dir/chunk_"
    
    # å‹ç¼©å¹¶ä¼ è¾“æ¯ä¸ªåˆ†å—
    for chunk in "$temp_dir"/chunk_*; do
        local chunk_name=$(basename "$chunk")
        local compressed_chunk="$temp_dir/${chunk_name}.xz"
        
        # æ£€æŸ¥è¿œç¨‹æ˜¯å¦å·²å­˜åœ¨è¯¥åˆ†å—
        if ssh "$target_host" "test -f $target_path.chunks/${chunk_name}.xz"; then
            echo "åˆ†å— $chunk_name å·²å­˜åœ¨ï¼Œè·³è¿‡"
            continue
        fi
        
        # å‹ç¼©åˆ†å—
        echo "å‹ç¼©åˆ†å— $chunk_name..."
        xz -6 "$chunk" -c > "$compressed_chunk"
        
        # ä¼ è¾“åˆ†å—ï¼ˆå¸¦é‡è¯•ï¼‰
        local retry=0
        while [ $retry -lt 3 ]; do
            if scp "$compressed_chunk" "$target_host:$target_path.chunks/${chunk_name}.xz"; then
                echo "åˆ†å— $chunk_name ä¼ è¾“æˆåŠŸ"
                break
            else
                retry=$((retry + 1))
                echo "åˆ†å— $chunk_name ä¼ è¾“å¤±è´¥ï¼Œé‡è¯•ç¬¬ $retry æ¬¡"
                sleep 5
            fi
        done
    done
    
    # åœ¨è¿œç¨‹ä¸»æœºé‡ç»„æ–‡ä»¶
    ssh "$target_host" "
        cd $(dirname $target_path)
        cat $target_path.chunks/*.xz | unxz > $(basename $target_path)
        rm -rf $target_path.chunks
    "
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -rf "$temp_dir"
    echo "æ–­ç‚¹ç»­ä¼ å®Œæˆ"
}
```

---

## 4. ğŸ—‚ï¸ å¤§è§„æ¨¡æ–‡ä»¶æ‰¹é‡å‹ç¼©ç®¡ç†


### 4.1 æ‰¹é‡å‹ç¼©ç­–ç•¥è®¾è®¡


**æ‰¹é‡æ“ä½œçš„æŒ‘æˆ˜**ï¼š
- **æ–‡ä»¶æ•°é‡å¤š**ï¼šå¯èƒ½æœ‰æ•°ä¸‡ä¸ªæ–‡ä»¶éœ€è¦å¤„ç†
- **å¤§å°ä¸å‡**ï¼šä»KBåˆ°GBçº§åˆ«æ–‡ä»¶æ··åˆå­˜åœ¨  
- **ç±»å‹å¤æ‚**ï¼šæ–‡æœ¬ã€äºŒè¿›åˆ¶ã€åª’ä½“æ–‡ä»¶å‹ç¼©æ•ˆæœä¸åŒ
- **æ—¶é—´çª—å£**ï¼šéœ€è¦åœ¨ä¸šåŠ¡ä½å³°æœŸå®Œæˆæ“ä½œ

### 4.2 æ™ºèƒ½æ‰¹é‡å‹ç¼©å·¥å…·


**æ–‡ä»¶åˆ†ç±»å‹ç¼©è„šæœ¬**ï¼š
```bash
#!/bin/bash
# batch_compress.sh - æ™ºèƒ½æ‰¹é‡å‹ç¼©

batch_compress() {
    local source_dir=$1
    local target_dir=$2
    local log_file="/var/log/batch_compress.log"
    
    # åˆ›å»ºç›®æ ‡ç›®å½•
    mkdir -p "$target_dir"
    
    # ç»Ÿè®¡æ–‡ä»¶ä¿¡æ¯
    echo "[$(date)] å¼€å§‹æ‰¹é‡å‹ç¼©ä»»åŠ¡ï¼š$source_dir -> $target_dir" >> $log_file
    
    # æŒ‰æ–‡ä»¶ç±»å‹å’Œå¤§å°åˆ†ç±»å¤„ç†
    find "$source_dir" -type f -print0 | while IFS= read -r -d '' file; do
        local file_size=$(stat -c%s "$file")
        local file_ext="${file##*.}"
        local relative_path="${file#$source_dir/}"
        local target_file="$target_dir/$relative_path"
        
        # åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„
        mkdir -p "$(dirname "$target_file")"
        
        # æ ¹æ®æ–‡ä»¶ç±»å‹å’Œå¤§å°é€‰æ‹©å‹ç¼©ç­–ç•¥
        case "$file_ext" in
            "log"|"txt"|"csv"|"json"|"xml")
                # æ–‡æœ¬æ–‡ä»¶ï¼šé«˜å‹ç¼©æ¯”
                if [ $file_size -gt 104857600 ]; then  # >100MB
                    echo "å¤§æ–‡æœ¬æ–‡ä»¶: $file (ä½¿ç”¨xz -9)" >> $log_file
                    xz -9 -c "$file" > "$target_file.xz"
                else
                    echo "å°æ–‡æœ¬æ–‡ä»¶: $file (ä½¿ç”¨gzip -9)" >> $log_file  
                    gzip -9 -c "$file" > "$target_file.gz"
                fi
                ;;
            "jpg"|"jpeg"|"png"|"gif"|"mp4"|"avi")
                # åª’ä½“æ–‡ä»¶ï¼šå·²ç»å‹ç¼©ï¼Œç›´æ¥å¤åˆ¶
                echo "åª’ä½“æ–‡ä»¶: $file (ç›´æ¥å¤åˆ¶)" >> $log_file
                cp "$file" "$target_file"
                ;;
            "gz"|"xz"|"bz2"|"zip")
                # å·²å‹ç¼©æ–‡ä»¶ï¼šç›´æ¥å¤åˆ¶
                echo "å·²å‹ç¼©æ–‡ä»¶: $file (ç›´æ¥å¤åˆ¶)" >> $log_file
                cp "$file" "$target_file"
                ;;
            *)
                # å…¶ä»–æ–‡ä»¶ï¼šæ ‡å‡†å‹ç¼©
                if [ $file_size -gt 52428800 ]; then  # >50MB
                    echo "å¤§æ–‡ä»¶: $file (ä½¿ç”¨xz -6)" >> $log_file
                    xz -6 -c "$file" > "$target_file.xz"
                else
                    echo "å°æ–‡ä»¶: $file (ä½¿ç”¨gzip -6)" >> $log_file
                    gzip -6 -c "$file" > "$target_file.gz"
                fi
                ;;
        esac
    done
    
    echo "[$(date)] æ‰¹é‡å‹ç¼©ä»»åŠ¡å®Œæˆ" >> $log_file
}
```

### 4.3 å‹ç¼©æ•ˆæœç»Ÿè®¡åˆ†æ


**å‹ç¼©ç»Ÿè®¡è„šæœ¬**ï¼š
```bash
#!/bin/bash
# compress_stats.sh - å‹ç¼©æ•ˆæœç»Ÿè®¡

generate_compress_stats() {
    local source_dir=$1
    local compressed_dir=$2
    local report_file="/tmp/compress_report_$(date +%Y%m%d).txt"
    
    echo "======== å‹ç¼©æ•ˆæœç»Ÿè®¡æŠ¥å‘Š ========" > $report_file
    echo "ç”Ÿæˆæ—¶é—´: $(date)" >> $report_file
    echo "æºç›®å½•: $source_dir" >> $report_file
    echo "å‹ç¼©ç›®å½•: $compressed_dir" >> $report_file
    echo "" >> $report_file
    
    # è®¡ç®—æ€»ä½“å‹ç¼©æ•ˆæœ
    local original_size=$(du -sb "$source_dir" | cut -f1)
    local compressed_size=$(du -sb "$compressed_dir" | cut -f1)
    local compression_ratio=$(echo "scale=2; ($original_size - $compressed_size) * 100 / $original_size" | bc)
    
    echo "åŸå§‹æ€»å¤§å°: $(numfmt --to=iec $original_size)" >> $report_file
    echo "å‹ç¼©åå¤§å°: $(numfmt --to=iec $compressed_size)" >> $report_file
    echo "å‹ç¼©ç‡: ${compression_ratio}%" >> $report_file
    echo "" >> $report_file
    
    # æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡
    echo "======== æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡ ========" >> $report_file
    for ext in log txt csv json gz xz jpg png mp4; do
        local ext_original=$(find "$source_dir" -name "*.$ext" -exec du -cb {} + 2>/dev/null | tail -1 | cut -f1 || echo "0")
        local ext_compressed=$(find "$compressed_dir" -name "*.$ext*" -exec du -cb {} + 2>/dev/null | tail -1 | cut -f1 || echo "0")
        
        if [ "$ext_original" -gt 0 ]; then
            local ext_ratio=$(echo "scale=2; ($ext_original - $ext_compressed) * 100 / $ext_original" | bc)
            echo "$ext æ–‡ä»¶: åŸå§‹$(numfmt --to=iec $ext_original) -> å‹ç¼©å$(numfmt --to=iec $ext_compressed) (${ext_ratio}%)" >> $report_file
        fi
    done
    
    echo "æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

---

## 5. ğŸš¦ å‹ç¼©æ“ä½œçš„å¹¶å‘æ§åˆ¶ä¸é˜Ÿåˆ—ç®¡ç†


### 5.1 å¹¶å‘æ§åˆ¶çš„å¿…è¦æ€§


> ğŸ“– **æ¦‚å¿µè§£é‡Š**ï¼šå¹¶å‘æ§åˆ¶æ˜¯æŒ‡åŒæ—¶è¿è¡Œçš„å‹ç¼©ä»»åŠ¡æ•°é‡ç®¡ç†ï¼Œé˜²æ­¢è¿‡å¤šå¹¶å‘ä»»åŠ¡è€—å°½ç³»ç»Ÿèµ„æºã€‚

**å¹¶å‘æ§åˆ¶è¦ç´ **ï¼š
```
ç³»ç»Ÿèµ„æºé™åˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CPUæ ¸å¿ƒ   â”‚    â”‚   å†…å­˜å®¹é‡   â”‚    â”‚  ç£ç›˜I/O    â”‚
â”‚   é™åˆ¶å¹¶å‘   â”‚    â”‚   é™åˆ¶ç¼“å­˜   â”‚    â”‚   é™åˆ¶è¯»å†™   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
            â”‚      æœ€ä¼˜å¹¶å‘æ•°è®¡ç®—        â”‚
            â”‚  = min(CPUæ ¸å¿ƒ/2, å¯ç”¨å†…å­˜ â”‚
            â”‚       /å•ä»»åŠ¡å†…å­˜éœ€æ±‚)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 é˜Ÿåˆ—ç®¡ç†ç³»ç»Ÿå®ç°


**å‹ç¼©ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†å™¨**ï¼š
```bash
#!/bin/bash
# compress_queue.sh - å‹ç¼©ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†

# å…¨å±€é…ç½®
QUEUE_DIR="/var/run/compress_queue"
MAX_CONCURRENT=4
PID_FILE="$QUEUE_DIR/manager.pid"
QUEUE_FILE="$QUEUE_DIR/tasks.queue"
LOCK_FILE="$QUEUE_DIR/queue.lock"

# åˆå§‹åŒ–é˜Ÿåˆ—
init_queue() {
    mkdir -p "$QUEUE_DIR"
    touch "$QUEUE_FILE"
    echo $$ > "$PID_FILE"
    
    # è®¡ç®—æœ€ä¼˜å¹¶å‘æ•°
    local cpu_cores=$(nproc)
    local available_memory=$(free -m | awk 'NR==2{printf "%.0f", $7}')  # å¯ç”¨å†…å­˜MB
    local memory_per_task=512  # æ¯ä¸ªå‹ç¼©ä»»åŠ¡é¢„ä¼°å†…å­˜éœ€æ±‚
    
    local max_by_cpu=$((cpu_cores / 2))
    local max_by_memory=$((available_memory / memory_per_task))
    
    MAX_CONCURRENT=$(( max_by_cpu < max_by_memory ? max_by_cpu : max_by_memory ))
    MAX_CONCURRENT=$(( MAX_CONCURRENT > 1 ? MAX_CONCURRENT : 1 ))  # è‡³å°‘1ä¸ª
    
    echo "[$(date)] é˜Ÿåˆ—ç®¡ç†å™¨å¯åŠ¨ï¼Œæœ€å¤§å¹¶å‘æ•°: $MAX_CONCURRENT"
}

# æ·»åŠ ä»»åŠ¡åˆ°é˜Ÿåˆ—
add_task() {
    local source_file=$1
    local compress_type=$2
    local priority=${3:-5}  # é»˜è®¤ä¼˜å…ˆçº§5
    
    (
        flock -x 200
        echo "$priority|$compress_type|$source_file|$(date +%s)" >> "$QUEUE_FILE"
        echo "ä»»åŠ¡å·²æ·»åŠ åˆ°é˜Ÿåˆ—: $source_file"
    ) 200>"$LOCK_FILE"
}

# ä»é˜Ÿåˆ—è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡
get_next_task() {
    (
        flock -x 200
        if [ -s "$QUEUE_FILE" ]; then
            # æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œè·å–ç¬¬ä¸€ä¸ªä»»åŠ¡
            local next_task=$(sort -n "$QUEUE_FILE" | head -1)
            
            # ä»é˜Ÿåˆ—ä¸­ç§»é™¤è¯¥ä»»åŠ¡
            local temp_file=$(mktemp)
            grep -v "^$next_task$" "$QUEUE_FILE" > "$temp_file"
            mv "$temp_file" "$QUEUE_FILE"
            
            echo "$next_task"
        fi
    ) 200>"$LOCK_FILE"
}

# æ‰§è¡Œå‹ç¼©ä»»åŠ¡
execute_task() {
    local task_info=$1
    local priority=$(echo "$task_info" | cut -d'|' -f1)
    local compress_type=$(echo "$task_info" | cut -d'|' -f2)
    local source_file=$(echo "$task_info" | cut -d'|' -f3)
    local task_id="task_$$_$(date +%s)"
    
    echo "[$(date)] å¼€å§‹æ‰§è¡Œä»»åŠ¡: $source_file (ä¼˜å…ˆçº§: $priority, ç±»å‹: $compress_type)"
    
    # æ ¹æ®å‹ç¼©ç±»å‹æ‰§è¡Œç›¸åº”æ“ä½œ
    case "$compress_type" in
        "gzip")
            gzip -6 "$source_file" && echo "[$(date)] GZIPå‹ç¼©å®Œæˆ: $source_file.gz"
            ;;
        "xz")
            xz -6 "$source_file" && echo "[$(date)] XZå‹ç¼©å®Œæˆ: $source_file.xz"
            ;;
        "bzip2")
            bzip2 -6 "$source_file" && echo "[$(date)] BZIP2å‹ç¼©å®Œæˆ: $source_file.bz2"
            ;;
        *)
            echo "[$(date)] é”™è¯¯ï¼šæœªçŸ¥å‹ç¼©ç±»å‹ $compress_type"
            return 1
            ;;
    esac
}

# é˜Ÿåˆ—ç®¡ç†å™¨ä¸»å¾ªç¯
queue_manager() {
    local running_tasks=0
    
    while true; do
        # æ¸…ç†å·²å®Œæˆçš„åå°ä»»åŠ¡
        wait -n 2>/dev/null
        running_tasks=$(jobs -r | wc -l)
        
        # å¦‚æœæœ‰ç©ºé—²æ§½ä½ä¸”é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡
        if [ $running_tasks -lt $MAX_CONCURRENT ]; then
            local next_task=$(get_next_task)
            
            if [ -n "$next_task" ]; then
                # åå°æ‰§è¡Œä»»åŠ¡
                execute_task "$next_task" &
                running_tasks=$((running_tasks + 1))
                echo "[$(date)] å¯åŠ¨æ–°ä»»åŠ¡ï¼Œå½“å‰è¿è¡Œ: $running_tasks/$MAX_CONCURRENT"
            else
                # é˜Ÿåˆ—ä¸ºç©ºï¼Œç­‰å¾…æ–°ä»»åŠ¡
                sleep 5
            fi
        else
            # å·²è¾¾æœ€å¤§å¹¶å‘æ•°ï¼Œç­‰å¾…ä»»åŠ¡å®Œæˆ
            sleep 2
        fi
    done
}
```

### 5.3 åŠ¨æ€è´Ÿè½½è°ƒæ•´


**è´Ÿè½½è‡ªé€‚åº”å¹¶å‘è°ƒæ•´**ï¼š
```bash
# åŠ¨æ€è°ƒæ•´å¹¶å‘æ•°
adjust_concurrency() {
    local current_load=$(uptime | awk '{print $3}' | cut -d',' -f1)
    local cpu_cores=$(nproc)
    local load_threshold=$cpu_cores
    
    # æ ¹æ®ç³»ç»Ÿè´Ÿè½½è°ƒæ•´å¹¶å‘æ•°
    if (( $(echo "$current_load > $load_threshold * 1.5" | bc -l) )); then
        # é«˜è´Ÿè½½ï¼šå‡å°‘å¹¶å‘
        MAX_CONCURRENT=$(( MAX_CONCURRENT > 1 ? MAX_CONCURRENT - 1 : 1 ))
        echo "[$(date)] ç³»ç»Ÿè´Ÿè½½é«˜ï¼Œé™ä½å¹¶å‘æ•°è‡³: $MAX_CONCURRENT"
    elif (( $(echo "$current_load < $load_threshold * 0.5" | bc -l) )); then
        # ä½è´Ÿè½½ï¼šå¯ä»¥å¢åŠ å¹¶å‘
        local max_possible=$(nproc)
        if [ $MAX_CONCURRENT -lt $max_possible ]; then
            MAX_CONCURRENT=$((MAX_CONCURRENT + 1))
            echo "[$(date)] ç³»ç»Ÿè´Ÿè½½ä½ï¼Œæé«˜å¹¶å‘æ•°è‡³: $MAX_CONCURRENT"
        fi
    fi
}
```

---

## 6. â° ç”Ÿäº§ç³»ç»Ÿå‹ç¼©ä»»åŠ¡è°ƒåº¦ç­–ç•¥


### 6.1 è°ƒåº¦ç­–ç•¥è®¾è®¡åŸåˆ™


**è°ƒåº¦æ—¶æœºé€‰æ‹©**ï¼š
```
ä¸šåŠ¡å½±å“æœ€å°åŒ–ç­–ç•¥ï¼š

é«˜å³°æœŸ (09:00-18:00):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç¦æ­¢å¤§å‹å‹ç¼©      â”‚
â”‚   åªå…è®¸ç´§æ€¥å‹ç¼©     â”‚
â”‚   æœ€å¤§å¹¶å‘æ•°: 1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¹³å³°æœŸ (18:00-22:00):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å…è®¸ä¸­ç­‰å‹ç¼©ä»»åŠ¡    â”‚
â”‚   æœ€å¤§å¹¶å‘æ•°: 2      â”‚
â”‚   å•ä»»åŠ¡æ—¶é—´é™åˆ¶     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½å³°æœŸ (22:00-06:00):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ‰¹é‡å‹ç¼©æœ€ä½³æ—¶é—´    â”‚
â”‚   æœ€å¤§å¹¶å‘æ•°: 4      â”‚
â”‚   æ— æ—¶é—´é™åˆ¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ™ºèƒ½è°ƒåº¦ç³»ç»Ÿ


**åŸºäºæ—¶é—´å’Œè´Ÿè½½çš„è°ƒåº¦å™¨**ï¼š
```bash
#!/bin/bash
# smart_scheduler.sh - æ™ºèƒ½å‹ç¼©è°ƒåº¦å™¨

# è°ƒåº¦é…ç½®
SCHEDULE_CONFIG="/etc/compress_schedule.conf"
SCHEDULER_LOG="/var/log/compress_scheduler.log"

# é»˜è®¤è°ƒåº¦é…ç½®
cat > $SCHEDULE_CONFIG << 'EOF'
# æ—¶é—´æ®µé…ç½® (24å°æ—¶åˆ¶)
# æ ¼å¼: å¼€å§‹æ—¶é—´-ç»“æŸæ—¶é—´|æœ€å¤§å¹¶å‘|æœ€å¤§å•ä»»åŠ¡å¤§å°(MB)|å…è®¸çš„å‹ç¼©ç±»å‹
06:00-09:00|2|500|gzip,xz
09:00-18:00|1|100|gzip
18:00-22:00|2|1000|gzip,xz
22:00-06:00|4|0|gzip,xz,bzip2
EOF

# è·å–å½“å‰è°ƒåº¦ç­–ç•¥
get_current_schedule() {
    local current_hour=$(date +%H)
    local current_min=$(date +%M)
    local current_time=$((current_hour * 100 + current_min))
    
    while IFS='|' read -r time_range max_concurrent max_size allowed_types; do
        # è·³è¿‡æ³¨é‡Šè¡Œ
        [[ "$time_range" =~ ^#.* ]] && continue
        
        local start_time=$(echo "$time_range" | cut -d'-' -f1 | tr ':' '' | sed 's/^0*//')
        local end_time=$(echo "$time_range" | cut -d'-' -f2 | tr ':' '' | sed 's/^0*//')
        
        # å¤„ç†è·¨å¤©çš„æ—¶é—´æ®µ (å¦‚22:00-06:00)
        if [ "$start_time" -gt "$end_time" ]; then
            if [ "$current_time" -ge "$start_time" ] || [ "$current_time" -lt "$end_time" ]; then
                echo "$max_concurrent|$max_size|$allowed_types"
                return
            fi
        else
            if [ "$current_time" -ge "$start_time" ] && [ "$current_time" -lt "$end_time" ]; then
                echo "$max_concurrent|$max_size|$allowed_types"
                return
            fi
        fi
    done < "$SCHEDULE_CONFIG"
    
    # é»˜è®¤ç­–ç•¥
    echo "1|100|gzip"
}

# ä»»åŠ¡è°ƒåº¦å†³ç­–
schedule_decision() {
    local file_path=$1
    local compress_type=$2
    local file_size_mb=$3
    
    local schedule_info=$(get_current_schedule)
    local max_concurrent=$(echo "$schedule_info" | cut -d'|' -f1)
    local max_size=$(echo "$schedule_info" | cut -d'|' -f2)
    local allowed_types=$(echo "$schedule_info" | cut -d'|' -f3)
    
    # æ£€æŸ¥å‹ç¼©ç±»å‹æ˜¯å¦å…è®¸
    if [[ ! "$allowed_types" =~ $compress_type ]]; then
        echo "REJECT|å‹ç¼©ç±»å‹ $compress_type åœ¨å½“å‰æ—¶æ®µä¸å…è®¸"
        return 1
    fi
    
    # æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶ (0è¡¨ç¤ºæ— é™åˆ¶)
    if [ "$max_size" -gt 0 ] && [ "$file_size_mb" -gt "$max_size" ]; then
        echo "DELAY|æ–‡ä»¶è¿‡å¤§($file_size_mb MB > $max_size MB)ï¼Œå»¶è¿Ÿåˆ°ä½å³°æœŸ"
        return 2
    fi
    
    # æ£€æŸ¥å½“å‰è¿è¡Œçš„ä»»åŠ¡æ•°
    local current_tasks=$(pgrep -c -f "gzip|xz|bzip2")
    if [ "$current_tasks" -ge "$max_concurrent" ]; then
        echo "QUEUE|å½“å‰å¹¶å‘å·²æ»¡($current_tasks/$max_concurrent)ï¼ŒåŠ å…¥é˜Ÿåˆ—"
        return 3
    fi
    
    echo "APPROVE|å…è®¸ç«‹å³æ‰§è¡Œ"
    return 0
}

# å»¶è¿Ÿä»»åŠ¡ç®¡ç†
manage_delayed_tasks() {
    local delay_queue="/tmp/delayed_compress_tasks"
    
    # æ£€æŸ¥æ˜¯å¦è¿›å…¥ä½å³°æœŸ
    local schedule_info=$(get_current_schedule)
    local max_size=$(echo "$schedule_info" | cut -d'|' -f2)
    
    # å¦‚æœç°åœ¨å…è®¸å¤§æ–‡ä»¶å‹ç¼©ï¼Œå¤„ç†å»¶è¿Ÿé˜Ÿåˆ—
    if [ "$max_size" -eq 0 ] || [ "$max_size" -gt 1000 ]; then
        if [ -f "$delay_queue" ]; then
            echo "[$(date)] è¿›å…¥ä½å³°æœŸï¼Œå¤„ç†å»¶è¿Ÿä»»åŠ¡" >> $SCHEDULER_LOG
            
            while IFS='|' read -r file_path compress_type; do
                echo "å¤„ç†å»¶è¿Ÿä»»åŠ¡: $file_path ($compress_type)" >> $SCHEDULER_LOG
                add_task "$file_path" "$compress_type" 1  # é«˜ä¼˜å…ˆçº§
            done < "$delay_queue"
            
            rm "$delay_queue"
        fi
    fi
}
```

### 6.3 è°ƒåº¦ç›‘æ§ä¸æŠ¥å‘Š


**è°ƒåº¦æ•ˆæœç›‘æ§**ï¼š
```bash
# ç”Ÿæˆè°ƒåº¦æŠ¥å‘Š
generate_schedule_report() {
    local report_date=${1:-$(date +%Y-%m-%d)}
    local report_file="/var/log/schedule_report_$report_date.txt"
    
    echo "========== å‹ç¼©è°ƒåº¦æŠ¥å‘Š ==========" > $report_file
    echo "æŠ¥å‘Šæ—¥æœŸ: $report_date" >> $report_file
    echo "" >> $report_file
    
    # ç»Ÿè®¡å„æ—¶æ®µä»»åŠ¡æ•°é‡
    echo "======== æ—¶æ®µä»»åŠ¡ç»Ÿè®¡ ========" >> $report_file
    for hour in $(seq -w 00 23); do
        local task_count=$(grep "^$report_date $hour:" $SCHEDULER_LOG | wc -l)
        echo "${hour}:00-${hour}:59  ä»»åŠ¡æ•°: $task_count" >> $report_file
    done
    
    echo "" >> $report_file
    
    # ç»Ÿè®¡ä»»åŠ¡çŠ¶æ€
    echo "======== ä»»åŠ¡çŠ¶æ€ç»Ÿè®¡ ========" >> $report_file
    local approved=$(grep "APPROVE" $SCHEDULER_LOG | grep "$report_date" | wc -l)
    local queued=$(grep "QUEUE" $SCHEDULER_LOG | grep "$report_date" | wc -l)
    local delayed=$(grep "DELAY" $SCHEDULER_LOG | grep "$report_date" | wc -l)
    local rejected=$(grep "REJECT" $SCHEDULER_LOG | grep "$report_date" | wc -l)
    
    echo "ç«‹å³æ‰§è¡Œ: $approved" >> $report_file
    echo "æ’é˜Ÿç­‰å¾…: $queued" >> $report_file
    echo "å»¶è¿Ÿæ‰§è¡Œ: $delayed" >> $report_file
    echo "æ‹’ç»æ‰§è¡Œ: $rejected" >> $report_file
    
    echo "è°ƒåº¦æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

---

## 7. âš ï¸ å‹ç¼©å¤±è´¥çš„é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶


### 7.1 å¸¸è§å‹ç¼©å¤±è´¥åŸå› 


**å¤±è´¥åŸå› åˆ†ç±»**ï¼š
```
ç³»ç»Ÿèµ„æºä¸è¶³ï¼š
â”œâ”€â”€ ç£ç›˜ç©ºé—´ä¸è¶³ (æœ€å¸¸è§)
â”œâ”€â”€ å†…å­˜ä¸è¶³
â”œâ”€â”€ CPUè´Ÿè½½è¿‡é«˜
â””â”€â”€ æ–‡ä»¶æè¿°ç¬¦è€—å°½

æ–‡ä»¶è®¿é—®é—®é¢˜ï¼š
â”œâ”€â”€ æƒé™ä¸è¶³
â”œâ”€â”€ æ–‡ä»¶è¢«å ç”¨
â”œâ”€â”€ æ–‡ä»¶æŸå
â””â”€â”€ ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿé—®é¢˜

å‹ç¼©å·¥å…·é—®é¢˜ï¼š
â”œâ”€â”€ å·¥å…·ç‰ˆæœ¬ä¸å…¼å®¹
â”œâ”€â”€ å‚æ•°é…ç½®é”™è¯¯
â”œâ”€â”€ å·¥å…·æœ¬èº«å´©æºƒ
â””â”€â”€ å‹ç¼©ç®—æ³•é™åˆ¶
```

### 7.2 é”™è¯¯æ£€æµ‹ä¸åˆ†ç±»


**æ™ºèƒ½é”™è¯¯æ£€æµ‹è„šæœ¬**ï¼š
```bash
#!/bin/bash
# error_handler.sh - å‹ç¼©é”™è¯¯å¤„ç†å™¨

# é”™è¯¯ç±»å‹å®šä¹‰
declare -A ERROR_TYPES=(
    ["ENOSPC"]="ç£ç›˜ç©ºé—´ä¸è¶³"
    ["ENOMEM"]="å†…å­˜ä¸è¶³"
    ["EACCES"]="æƒé™ä¸è¶³"
    ["EBUSY"]="æ–‡ä»¶è¢«å ç”¨"
    ["EINTR"]="æ“ä½œè¢«ä¸­æ–­"
    ["ENOENT"]="æ–‡ä»¶ä¸å­˜åœ¨"
    ["EIO"]="è¾“å…¥è¾“å‡ºé”™è¯¯"
)

# é”™è¯¯æ£€æµ‹å‡½æ•°
detect_error_type() {
    local exit_code=$1
    local error_output=$2
    local source_file=$3
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    local available_space=$(df "$(dirname "$source_file")" | awk 'NR==2 {print $4}')
    local file_size=$(stat -c%s "$source_file" 2>/dev/null || echo 0)
    
    if [ "$available_space" -lt "$file_size" ]; then
        echo "ENOSPC|ç£ç›˜ç©ºé—´ä¸è¶³"
        return
    fi
    
    # æ£€æŸ¥å†…å­˜æƒ…å†µ
    local available_mem=$(free -m | awk 'NR==2{print $7}')
    if [ "$available_mem" -lt 100 ]; then
        echo "ENOMEM|å†…å­˜ä¸è¶³"
        return
    fi
    
    # æ£€æŸ¥æ–‡ä»¶æƒé™
    if [ ! -r "$source_file" ]; then
        echo "EACCES|æ–‡ä»¶è¯»æƒé™ä¸è¶³"
        return
    fi
    
    if [ ! -w "$(dirname "$source_file")" ]; then
        echo "EACCES|ç›®å½•å†™æƒé™ä¸è¶³"
        return
    fi
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«å ç”¨
    if lsof "$source_file" >/dev/null 2>&1; then
        echo "EBUSY|æ–‡ä»¶è¢«å…¶ä»–è¿›ç¨‹å ç”¨"
        return
    fi
    
    # æ ¹æ®é”™è¯¯è¾“å‡ºåˆ¤æ–­
    case "$error_output" in
        *"No space left"*|*"ç©ºé—´ä¸è¶³"*)
            echo "ENOSPC|ç£ç›˜ç©ºé—´ä¸è¶³"
            ;;
        *"Permission denied"*|*"æƒé™è¢«æ‹’ç»"*)
            echo "EACCES|æƒé™ä¸è¶³"
            ;;
        *"Device or resource busy"*|*"è®¾å¤‡å¿™"*)
            echo "EBUSY|è®¾å¤‡æˆ–èµ„æºå¿™"
            ;;
        *"Interrupted"*|*"ä¸­æ–­"*)
            echo "EINTR|æ“ä½œè¢«ä¸­æ–­"
            ;;
        *"Input/output error"*|*"è¾“å…¥è¾“å‡ºé”™è¯¯"*)
            echo "EIO|è¾“å…¥è¾“å‡ºé”™è¯¯"
            ;;
        *)
            echo "UNKNOWN|æœªçŸ¥é”™è¯¯(é€€å‡ºç :$exit_code)"
            ;;
    esac
}

# é”™è¯¯å¤„ç†ç­–ç•¥
handle_compression_error() {
    local source_file=$1
    local compress_type=$2
    local error_info=$3
    local attempt_count=${4:-1}
    
    local error_code=$(echo "$error_info" | cut -d'|' -f1)
    local error_desc=$(echo "$error_info" | cut -d'|' -f2)
    local error_log="/var/log/compression_errors.log"
    
    echo "[$(date)] å‹ç¼©å¤±è´¥: $source_file - $error_desc (å°è¯•æ¬¡æ•°: $attempt_count)" >> $error_log
    
    # æ ¹æ®é”™è¯¯ç±»å‹åˆ¶å®šå¤„ç†ç­–ç•¥
    case "$error_code" in
        "ENOSPC")
            # ç£ç›˜ç©ºé—´ä¸è¶³ï¼šæ¸…ç†ä¸´æ—¶æ–‡ä»¶æˆ–ç­‰å¾…ç©ºé—´é‡Šæ”¾
            echo "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå°è¯•æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
            cleanup_temp_files
            
            # ç­‰å¾…5åˆ†é’Ÿåé‡è¯•
            echo "ç­‰å¾…ç£ç›˜ç©ºé—´é‡Šæ”¾ï¼Œ5åˆ†é’Ÿåé‡è¯•..."
            return 300  # è¿”å›é‡è¯•å»¶è¿Ÿç§’æ•°
            ;;
        "ENOMEM")
            # å†…å­˜ä¸è¶³ï¼šç­‰å¾…ç³»ç»Ÿå†…å­˜é‡Šæ”¾
            echo "å†…å­˜ä¸è¶³ï¼Œç­‰å¾…ç³»ç»Ÿå†…å­˜é‡Šæ”¾..."
            return 120
            ;;
        "EACCES")
            # æƒé™ä¸è¶³ï¼šå°è¯•ä¿®å¤æƒé™
            echo "å°è¯•ä¿®å¤æ–‡ä»¶æƒé™..."
            chmod u+rw "$source_file" 2>/dev/null
            return 10
            ;;
        "EBUSY")
            # æ–‡ä»¶è¢«å ç”¨ï¼šç­‰å¾…æ–‡ä»¶é‡Šæ”¾
            echo "æ–‡ä»¶è¢«å ç”¨ï¼Œç­‰å¾…æ–‡ä»¶é‡Šæ”¾..."
            return 60
            ;;
        "EINTR")
            # æ“ä½œè¢«ä¸­æ–­ï¼šç«‹å³é‡è¯•
            echo "æ“ä½œè¢«ä¸­æ–­ï¼Œç«‹å³é‡è¯•..."
            return 5
            ;;
        *)
            # å…¶ä»–é”™è¯¯ï¼šæ ¹æ®å°è¯•æ¬¡æ•°å†³å®š
            if [ $attempt_count -lt 3 ]; then
                return 30  # 30ç§’åé‡è¯•
            else
                echo "è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ”¾å¼ƒè¯¥ä»»åŠ¡"
                return -1  # ä¸å†é‡è¯•
            fi
            ;;
    esac
}

# ä¸´æ—¶æ–‡ä»¶æ¸…ç†
cleanup_temp_files() {
    local temp_dirs=("/tmp" "/var/tmp" "/var/log")
    
    for dir in "${temp_dirs[@]}"; do
        if [ -d "$dir" ]; then
            # æ¸…ç†è¶…è¿‡24å°æ—¶çš„ä¸´æ—¶æ–‡ä»¶
            find "$dir" -type f -name "*.tmp" -mtime +1 -delete 2>/dev/null
            find "$dir" -type f -name "tmp.*" -mtime +1 -delete 2>/dev/null
            
            echo "æ¸…ç†ä¸´æ—¶ç›®å½•: $dir"
        fi
    done
    
    # æ¸…ç†å‹ç¼©å·¥å…·çš„ä¸´æ—¶æ–‡ä»¶
    find /tmp -name ".gzip*" -o -name ".xz*" -o -name ".bzip2*" -delete 2>/dev/null
}
```

### 7.3 é‡è¯•æœºåˆ¶å®ç°


**æ™ºèƒ½é‡è¯•ç³»ç»Ÿ**ï¼š
```bash
#!/bin/bash
# retry_mechanism.sh - å‹ç¼©é‡è¯•æœºåˆ¶

# é‡è¯•é…ç½®
RETRY_CONFIG="/etc/compress_retry.conf"
RETRY_LOG="/var/log/compress_retry.log"
MAX_RETRIES=5

# åˆå§‹åŒ–é‡è¯•é…ç½®
init_retry_config() {
    cat > $RETRY_CONFIG << 'EOF'
# é‡è¯•ç­–ç•¥é…ç½®
# æ ¼å¼: é”™è¯¯ç±»å‹|æœ€å¤§é‡è¯•æ¬¡æ•°|é‡è¯•é—´éš”ç­–ç•¥|æ˜¯å¦æŒ‡æ•°é€€é¿
ENOSPC|3|300,600,1200|true
ENOMEM|3|60,120,240|true
EACCES|2|10,30|false
EBUSY|5|60,120,180,240,300|false
EINTR|3|5,10,20|false
UNKNOWN|2|30,60|false
EOF
}

# è·å–é‡è¯•ç­–ç•¥
get_retry_strategy() {
    local error_code=$1
    
    if [ -f "$RETRY_CONFIG" ]; then
        grep "^$error_code|" "$RETRY_CONFIG" | head -1
    else
        # é»˜è®¤ç­–ç•¥
        echo "$error_code|3|30,60,120|false"
    fi
}

# æ‰§è¡Œå¸¦é‡è¯•çš„å‹ç¼©
compress_with_retry() {
    local source_file=$1
    local compress_type=$2
    local max_attempts=${3:-$MAX_RETRIES}
    
    local attempt=1
    local retry_delays=""
    
    while [ $attempt -le $max_attempts ]; do
        echo "[$(date)] å°è¯•å‹ç¼© $source_file (ç¬¬ $attempt æ¬¡)" >> $RETRY_LOG
        
        # æ‰§è¡Œå‹ç¼©å‘½ä»¤
        local error_output
        local exit_code
        
        case "$compress_type" in
            "gzip")
                error_output=$(gzip -6 "$source_file" 2>&1)
                exit_code=$?
                ;;
            "xz")
                error_output=$(xz -6 "$source_file" 2>&1)
                exit_code=$?
                ;;
            "bzip2")
                error_output=$(bzip2 -6 "$source_file" 2>&1)
                exit_code=$?
                ;;
            *)
                echo "é”™è¯¯ï¼šä¸æ”¯æŒçš„å‹ç¼©ç±»å‹ $compress_type" >> $RETRY_LOG
                return 1
                ;;
        esac
        
        # å¦‚æœæˆåŠŸï¼Œè¿”å›
        if [ $exit_code -eq 0 ]; then
            echo "[$(date)] å‹ç¼©æˆåŠŸ: $source_file (ç¬¬ $attempt æ¬¡å°è¯•)" >> $RETRY_LOG
            return 0
        fi
        
        # æ£€æµ‹é”™è¯¯ç±»å‹
        local error_info=$(detect_error_type $exit_code "$error_output" "$source_file")
        local error_code=$(echo "$error_info" | cut -d'|' -f1)
        
        echo "[$(date)] å‹ç¼©å¤±è´¥: $source_file - $error_info" >> $RETRY_LOG
        
        # è·å–é‡è¯•ç­–ç•¥
        local retry_strategy=$(get_retry_strategy "$error_code")
        local max_retries_for_error=$(echo "$retry_strategy" | cut -d'|' -f2)
        local delay_sequence=$(echo "$retry_strategy" | cut -d'|' -f3)
        local exponential_backoff=$(echo "$retry_strategy" | cut -d'|' -f4)
        
        # æ£€æŸ¥æ˜¯å¦åº”è¯¥ç»§ç»­é‡è¯•
        if [ $attempt -ge $max_retries_for_error ]; then
            echo "[$(date)] è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•° ($max_retries_for_error)ï¼Œæ”¾å¼ƒ: $source_file" >> $RETRY_LOG
            return 1
        fi
        
        # è®¡ç®—å»¶è¿Ÿæ—¶é—´
        local delay
        if [ "$exponential_backoff" = "true" ]; then
            # æŒ‡æ•°é€€é¿
            delay=$((30 * (2 ** (attempt - 1))))
        else
            # ä»é…ç½®çš„å»¶è¿Ÿåºåˆ—ä¸­è·å–
            delay=$(echo "$delay_sequence" | cut -d',' -f$attempt)
            if [ -z "$delay" ]; then
                delay=60  # é»˜è®¤å»¶è¿Ÿ
            fi
        fi
        
        echo "[$(date)] ç­‰å¾… $delay ç§’åé‡è¯•..." >> $RETRY_LOG
        sleep $delay
        
        attempt=$((attempt + 1))
    done
    
    echo "[$(date)] æ‰€æœ‰é‡è¯•å°è¯•å¤±è´¥: $source_file" >> $RETRY_LOG
    return 1
}

# å¤±è´¥ä»»åŠ¡è®°å½•å’Œæ¢å¤
record_failed_task() {
    local source_file=$1
    local compress_type=$2
    local error_info=$3
    local failed_tasks_file="/var/log/failed_compress_tasks.log"
    
    echo "$(date +%s)|$source_file|$compress_type|$error_info" >> $failed_tasks_file
}

# é‡è¯•å¤±è´¥ä»»åŠ¡
retry_failed_tasks() {
    local failed_tasks_file="/var/log/failed_compress_tasks.log"
    local temp_file=$(mktemp)
    
    if [ ! -f "$failed_tasks_file" ]; then
        echo "æ²¡æœ‰å¤±è´¥çš„ä»»åŠ¡éœ€è¦é‡è¯•"
        return
    fi
    
    echo "[$(date)] å¼€å§‹é‡è¯•å¤±è´¥ä»»åŠ¡" >> $RETRY_LOG
    
    while IFS='|' read -r timestamp source_file compress_type error_info; do
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä»ç„¶å­˜åœ¨
        if [ ! -f "$source_file" ]; then
            echo "[$(date)] æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè·³è¿‡: $source_file" >> $RETRY_LOG
            continue
        fi
        
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»è¢«å‹ç¼©
        if [ -f "$source_file.gz" ] || [ -f "$source_file.xz" ] || [ -f "$source_file.bz2" ]; then
            echo "[$(date)] æ–‡ä»¶å·²è¢«å‹ç¼©ï¼Œè·³è¿‡: $source_file" >> $RETRY_LOG
            continue
        fi
        
        # é‡è¯•å‹ç¼©
        if compress_with_retry "$source_file" "$compress_type" 2; then
            echo "[$(date)] é‡è¯•æˆåŠŸ: $source_file" >> $RETRY_LOG
        else
            echo "[$(date)] é‡è¯•ä»ç„¶å¤±è´¥: $source_file" >> $RETRY_LOG
            # ä¿ç•™åˆ°æ–°çš„å¤±è´¥åˆ—è¡¨
            echo "$timestamp|$source_file|$compress_type|$error_info" >> $temp_file
        fi
    done < "$failed_tasks_file"
    
    # æ›´æ–°å¤±è´¥ä»»åŠ¡åˆ—è¡¨
    mv "$temp_file" "$failed_tasks_file"
    
    echo "[$(date)] å¤±è´¥ä»»åŠ¡é‡è¯•å®Œæˆ" >> $RETRY_LOG
}
```

---

## 8. ğŸ“ å‹ç¼©å·¥å…·é€‰æ‹©çš„æ ‡å‡†åŒ–è§„èŒƒ


### 8.1 å·¥å…·é€‰æ‹©å†³ç­–çŸ©é˜µ


**å‹ç¼©å·¥å…·ç‰¹æ€§å¯¹æ¯”**ï¼š

| å·¥å…· | **å‹ç¼©æ¯”** | **é€Ÿåº¦** | **CPUå ç”¨** | **å†…å­˜å ç”¨** | **é€‚ç”¨åœºæ™¯** |
|------|-----------|---------|------------|-------------|-------------|
| **gzip** | `ä¸­ç­‰` | `â­â­â­â­â­` | `ä½` | `ä½` | `å¿«é€Ÿå‹ç¼©ï¼Œå®æ—¶å¤„ç†` |
| **bzip2** | `é«˜` | `â­â­â­` | `ä¸­` | `ä¸­` | `å¹³è¡¡å‹ç¼©æ¯”å’Œé€Ÿåº¦` |
| **xz** | `æé«˜` | `â­â­` | `é«˜` | `é«˜` | `å­˜å‚¨ç©ºé—´ä¼˜å…ˆ` |
| **lz4** | `ä½` | `â­â­â­â­â­` | `æä½` | `æä½` | `å®æ—¶å‹ç¼©ï¼Œé«˜é¢‘è®¿é—®` |
| **zstd** | `é«˜` | `â­â­â­â­` | `ä¸­ä½` | `ä¸­` | `ç°ä»£åŒ–é€‰æ‹©ï¼Œå¹³è¡¡æ€§å¥½` |

### 8.2 é€‰æ‹©å†³ç­–ç®—æ³•


**æ™ºèƒ½å·¥å…·é€‰æ‹©ç³»ç»Ÿ**ï¼š
```bash
#!/bin/bash
# tool_selector.sh - å‹ç¼©å·¥å…·æ™ºèƒ½é€‰æ‹©

# æ–‡ä»¶ç±»å‹å‹ç¼©æ•ˆæœæ•°æ®åº“
declare -A FILE_TYPE_COMPRESSION=(
    ["txt"]="gzip:70,bzip2:75,xz:80"
    ["log"]="gzip:60,bzip2:65,xz:75"
    ["csv"]="gzip:80,bzip2:85,xz:90"
    ["json"]="gzip:75,bzip2:80,xz:85"
    ["xml"]="gzip:70,bzip2:75,xz:82"
    ["html"]="gzip:65,bzip2:70,xz:78"
    ["js"]="gzip:60,bzip2:65,xz:72"
    ["css"]="gzip:70,bzip2:75,xz:80"
    ["sql"]="gzip:75,bzip2:80,xz:85"
    ["conf"]="gzip:50,bzip2:55,xz:65"
)

# ç³»ç»Ÿç¯å¢ƒè¯„ä¼°
assess_system_environment() {
    local cpu_cores=$(nproc)
    local available_memory=$(free -m | awk 'NR==2{print $7}')
    local current_load=$(uptime | awk '{print $3}' | cut -d',' -f1)
    local disk_io=$(iostat -d 1 2 | tail -1 | awk '{print $4}')  # å†™å…¥é€Ÿåº¦
    
    # è¯„ä¼°ç³»ç»Ÿæ€§èƒ½ç­‰çº§
    local performance_score=0
    
    # CPUè¯„ä¼° (25åˆ†)
    if [ $cpu_cores -ge 8 ]; then
        performance_score=$((performance_score + 25))
    elif [ $cpu_cores -ge 4 ]; then
        performance_score=$((performance_score + 20))
    elif [ $cpu_cores -ge 2 ]; then
        performance_score=$((performance_score + 15))
    else
        performance_score=$((performance_score + 10))
    fi
    
    # å†…å­˜è¯„ä¼° (25åˆ†)
    if [ $available_memory -gt 4000 ]; then
        performance_score=$((performance_score + 25))
    elif [ $available_memory -gt 2000 ]; then
        performance_score=$((performance_score + 20))
    elif [ $available_memory -gt 1000 ]; then
        performance_score=$((performance_score + 15))
    else
        performance_score=$((performance_score + 10))
    fi
    
    # è´Ÿè½½è¯„ä¼° (25åˆ†)
    local load_percentage=$(echo "scale=2; $current_load * 100 / $cpu_cores" | bc)
    if (( $(echo "$load_percentage < 30" | bc -l) )); then
        performance_score=$((performance_score + 25))
    elif (( $(echo "$load_percentage < 60" | bc -l) )); then
        performance_score=$((performance_score + 20))
    elif (( $(echo "$load_percentage < 80" | bc -l) )); then
        performance_score=$((performance_score + 15))
    else
        performance_score=$((performance_score + 10))
    fi
    
    # ç£ç›˜I/Oè¯„ä¼° (25åˆ†)
    if [ "$disk_io" -lt 20 ]; then
        performance_score=$((performance_score + 25))
    elif [ "$disk_io" -lt 50 ]; then
        performance_score=$((performance_score + 20))
    elif [ "$disk_io" -lt 80 ]; then
        performance_score=$((performance_score + 15))
    else
        performance_score=$((performance_score + 10))
    fi
    
    echo $performance_score
}

# æ–‡ä»¶ç‰¹å¾åˆ†æ
analyze_file_characteristics() {
    local file_path=$1
    
    local file_size=$(stat -c%s "$file_path")
    local file_ext="${file_path##*.}"
    local file_type=$(file -b --mime-type "$file_path")
    
    # æ–‡ä»¶å¤§å°åˆ†ç±»
    local size_category
    if [ $file_size -lt 1048576 ]; then      # <1MB
        size_category="small"
    elif [ $file_size -lt 104857600 ]; then  # <100MB
        size_category="medium"
    elif [ $file_size -lt 1073741824 ]; then # <1GB
        size_category="large"
    else
        size_category="huge"
    fi
    
    # æ–‡ä»¶ç±»å‹åˆ†æ
    local compression_potential="medium"
    case "$file_type" in
        "text/"*|"application/json"|"application/xml")
            compression_potential="high"
            ;;
        "image/"*|"video/"*|"audio/"*)
            compression_potential="low"
            ;;
        "application/zip"|"application/gzip"|"application/x-xz")
            compression_potential="none"
            ;;
    esac
    
    echo "$size_category|$compression_potential|$file_ext|$file_type"
}

# å‹ç¼©å·¥å…·é€‰æ‹©å†³ç­–
select_compression_tool() {
    local file_path=$1
    local priority=${2:-"balanced"}  # speed|balanced|compression
    
    local system_score=$(assess_system_environment)
    local file_info=$(analyze_file_characteristics "$file_path")
    
    local size_category=$(echo "$file_info" | cut -d'|' -f1)
    local compression_potential=$(echo "$file_info" | cut -d'|' -f2)
    local file_ext=$(echo "$file_info" | cut -d'|' -f3)
    
    echo "[DEBUG] ç³»ç»Ÿè¯„åˆ†: $system_score, æ–‡ä»¶: $size_category/$compression_potential/$file_ext" >&2
    
    # å¦‚æœæ–‡ä»¶å·²ç»å‹ç¼©æˆ–æ— å‹ç¼©æ½œåŠ›ï¼Œå»ºè®®è·³è¿‡
    if [ "$compression_potential" = "none" ]; then
        echo "skip|æ–‡ä»¶å·²å‹ç¼©ï¼Œæ— éœ€å¤„ç†"
        return
    fi
    
    # æ ¹æ®ä¼˜å…ˆçº§å’Œç³»ç»Ÿæƒ…å†µé€‰æ‹©å·¥å…·
    case "$priority" in
        "speed")
            # é€Ÿåº¦ä¼˜å…ˆ
            if [ $system_score -lt 60 ]; then
                echo "lz4|ç³»ç»Ÿæ€§èƒ½è¾ƒä½ï¼Œé€‰æ‹©æœ€å¿«å‹ç¼©"
            else
                echo "gzip|å¹³è¡¡é€Ÿåº¦å’Œå‹ç¼©æ¯”"
            fi
            ;;
        "compression")
            # å‹ç¼©æ¯”ä¼˜å…ˆ
            if [ "$size_category" = "huge" ] && [ $system_score -gt 80 ]; then
                echo "xz|å¤§æ–‡ä»¶é«˜å‹ç¼©æ¯”"
            elif [ "$compression_potential" = "high" ]; then
                echo "xz|æ–‡æœ¬æ–‡ä»¶é«˜å‹ç¼©æ¯”"
            else
                echo "bzip2|å¹³è¡¡å‹ç¼©æ¯”å’Œé€Ÿåº¦"
            fi
            ;;
        "balanced"|*)
            # å¹³è¡¡é€‰æ‹©
            if [ $system_score -lt 50 ]; then
                # ç³»ç»Ÿæ€§èƒ½è¾ƒä½
                echo "gzip|ç³»ç»Ÿæ€§èƒ½é™åˆ¶ï¼Œé€‰æ‹©å¿«é€Ÿå‹ç¼©"
            elif [ $system_score -gt 80 ] && [ "$compression_potential" = "high" ]; then
                # é«˜æ€§èƒ½ç³»ç»Ÿï¼Œé«˜å‹ç¼©æ½œåŠ›
                if command -v zstd >/dev/null 2>&1; then
                    echo "zstd|ç°ä»£å‹ç¼©ç®—æ³•ï¼Œå¹³è¡¡æ€§æœ€ä½³"
                else
                    echo "xz|é«˜å‹ç¼©æ¯”é€‰æ‹©"
                fi
            else
                # æ ‡å‡†é€‰æ‹©
                case "$size_category" in
                    "small")
                        echo "gzip|å°æ–‡ä»¶å¿«é€Ÿå¤„ç†"
                        ;;
                    "medium")
                        if [ "$compression_potential" = "high" ]; then
                            echo "bzip2|ä¸­ç­‰æ–‡ä»¶å¹³è¡¡å‹ç¼©"
                        else
                            echo "gzip|å¿«é€Ÿå‹ç¼©"
                        fi
                        ;;
                    "large"|"huge")
                        if [ $system_score -gt 70 ]; then
                            echo "xz|å¤§æ–‡ä»¶é«˜å‹ç¼©æ¯”"
                        else
                            echo "bzip2|èµ„æºå—é™ä¸‹çš„å¹³è¡¡é€‰æ‹©"
                        fi
                        ;;
                esac
            fi
            ;;
    esac
}

# ç”Ÿæˆå‹ç¼©å»ºè®®æŠ¥å‘Š
generate_compression_recommendation() {
    local file_path=$1
    local report_file="/tmp/compression_recommendation_$$.txt"
    
    echo "========== å‹ç¼©å·¥å…·é€‰æ‹©å»ºè®® ==========" > $report_file
    echo "æ–‡ä»¶: $file_path" >> $report_file
    echo "åˆ†ææ—¶é—´: $(date)" >> $report_file
    echo "" >> $report_file
    
    # ç³»ç»Ÿç¯å¢ƒ
    local system_score=$(assess_system_environment)
    echo "ç³»ç»Ÿæ€§èƒ½è¯„åˆ†: $system_score/100" >> $report_file
    
    # æ–‡ä»¶ç‰¹å¾
    local file_info=$(analyze_file_characteristics "$file_path")
    echo "æ–‡ä»¶ç‰¹å¾: $file_info" >> $report_file
    echo "" >> $report_file
    
    # å„ç§ä¼˜å…ˆçº§ä¸‹çš„å»ºè®®
    echo "======== å·¥å…·é€‰æ‹©å»ºè®® ========" >> $report_file
    
    local speed_choice=$(select_compression_tool "$file_path" "speed")
    local balanced_choice=$(select_compression_tool "$file_path" "balanced")
    local compression_choice=$(select_compression_tool "$file_path" "compression")
    
    echo "é€Ÿåº¦ä¼˜å…ˆ: $(echo "$speed_choice" | cut -d'|' -f1) - $(echo "$speed_choice" | cut -d'|' -f2)" >> $report_file
    echo "å¹³è¡¡é€‰æ‹©: $(echo "$balanced_choice" | cut -d'|' -f1) - $(echo "$balanced_choice" | cut -d'|' -f2)" >> $report_file
    echo "å‹ç¼©ä¼˜å…ˆ: $(echo "$compression_choice" | cut -d'|' -f1) - $(echo "$compression_choice" | cut -d'|' -f2)" >> $report_file
    
    echo "" >> $report_file
    echo "æ¨èä½¿ç”¨: $(echo "$balanced_choice" | cut -d'|' -f1)" >> $report_file
    
    cat "$report_file"
    rm "$report_file"
}
```

### 8.3 æ ‡å‡†åŒ–é…ç½®æ–‡ä»¶


**ä¼ä¸šæ ‡å‡†å‹ç¼©ç­–ç•¥é…ç½®**ï¼š
```bash
# /etc/compression_policy.conf - ä¼ä¸šçº§å‹ç¼©ç­–ç•¥é…ç½®

[global]
# å…¨å±€é…ç½®
default_tool=gzip
max_parallel_jobs=4
temp_directory=/tmp/compress_work
log_level=info
enable_monitoring=true

[file_size_rules]
# æ ¹æ®æ–‡ä»¶å¤§å°é€‰æ‹©ç­–ç•¥
small_threshold=1048576      # 1MB
medium_threshold=104857600   # 100MB
large_threshold=1073741824   # 1GB

small_tool=gzip
small_level=6
medium_tool=bzip2
medium_level=6
large_tool=xz
large_level=6

[file_type_rules]
# æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©ç­–ç•¥
text_files=txt,log,csv,json,xml,html,js,css,sql,conf
text_tool=xz
text_level=9

binary_files=bin,exe,so,dll,lib
binary_tool=gzip
binary_level=6

media_files=jpg,jpeg,png,gif,mp4,avi,mp3,wav
media_action=skip  # åª’ä½“æ–‡ä»¶é€šå¸¸ä¸éœ€è¦å‹ç¼©

compressed_files=gz,xz,bz2,zip,7z,rar
compressed_action=skip  # å·²å‹ç¼©æ–‡ä»¶è·³è¿‡

[environment_rules]
# æ ¹æ®ç¯å¢ƒé€‰æ‹©ç­–ç•¥
production_hours=09:00-18:00
production_max_parallel=1
production_tool=gzip

maintenance_hours=02:00-06:00  
maintenance_max_parallel=8
maintenance_tool=xz

[retention_policy]
# å‹ç¼©æ–‡ä»¶ä¿ç•™ç­–ç•¥
delete_original_after_compress=true
verify_compressed_integrity=true
backup_critical_files=true
critical_file_patterns=/etc/*,/var/log/critical/*

[monitoring]
# ç›‘æ§é…ç½®
monitor_system_load=true
max_load_threshold=80
monitor_disk_space=true
min_disk_space_mb=1024
monitor_memory=true
min_memory_mb=512
```

### 8.4 æ ‡å‡†åŒ–å·¥ä½œæµç¨‹


**å‹ç¼©æ“ä½œæ ‡å‡†æµç¨‹**ï¼š
```
å‹ç¼©ä»»åŠ¡æ ‡å‡†æµç¨‹å›¾ï¼š

å¼€å§‹ä»»åŠ¡
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯»å–ç­–ç•¥é…ç½®    â”‚ â† ä»é…ç½®æ–‡ä»¶åŠ è½½è§„åˆ™
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶é¢„æ£€æŸ¥      â”‚ â† æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§ã€æƒé™ã€å¤§å°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç³»ç»Ÿèµ„æºè¯„ä¼°    â”‚ â† CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œçŠ¶æ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©å‹ç¼©å·¥å…·    â”‚ â† åŸºäºè§„åˆ™å’Œç¯å¢ƒé€‰æ‹©æœ€ä¼˜å·¥å…·
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œå‹ç¼©æ“ä½œ    â”‚ â† ç›‘æ§èµ„æºä½¿ç”¨ï¼Œè®°å½•æ—¥å¿—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®Œæ•´æ€§éªŒè¯      â”‚ â† éªŒè¯å‹ç¼©æ–‡ä»¶å¯æ­£å¸¸è§£å‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¸…ç†å’Œå½’æ¡£      â”‚ â† æ¸…ç†åŸæ–‡ä»¶ï¼Œç§»åŠ¨å‹ç¼©æ–‡ä»¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
ä»»åŠ¡å®Œæˆ
```

**æ ‡å‡†åŒ–æ“ä½œè„šæœ¬**ï¼š
```bash
#!/bin/bash
# standard_compress.sh - æ ‡å‡†åŒ–å‹ç¼©æ“ä½œè„šæœ¬

# é…ç½®æ–‡ä»¶è·¯å¾„
CONFIG_FILE="/etc/compression_policy.conf"
LOG_FILE="/var/log/standard_compress.log"

# åŠ è½½é…ç½®
load_config() {
    if [ ! -f "$CONFIG_FILE" ]; then
        echo "é”™è¯¯ï¼šé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ $CONFIG_FILE"
        exit 1
    fi
    
    # è¯»å–é…ç½®å‚æ•°ï¼ˆç®€åŒ–çš„é…ç½®è¯»å–ï¼‰
    DEFAULT_TOOL=$(grep "default_tool=" "$CONFIG_FILE" | cut -d'=' -f2)
    MAX_PARALLEL=$(grep "max_parallel_jobs=" "$CONFIG_FILE" | cut -d'=' -f2)
    TEMP_DIR=$(grep "temp_directory=" "$CONFIG_FILE" | cut -d'=' -f2)
    
    # åˆ›å»ºä¸´æ—¶ç›®å½•
    mkdir -p "$TEMP_DIR"
}

# æ ‡å‡†åŒ–å‹ç¼©æ‰§è¡Œ
standard_compress() {
    local source_file=$1
    local task_id="task_$(date +%s)_$"
    
    echo "[$(date)] [$task_id] å¼€å§‹æ ‡å‡†åŒ–å‹ç¼©: $source_file" >> $LOG_FILE
    
    # 1. æ–‡ä»¶é¢„æ£€æŸ¥
    if ! precheck_file "$source_file"; then
        echo "[$(date)] [$task_id] æ–‡ä»¶é¢„æ£€æŸ¥å¤±è´¥: $source_file" >> $LOG_FILE
        return 1
    fi
    
    # 2. ç³»ç»Ÿèµ„æºè¯„ä¼°
    if ! check_system_resources; then
        echo "[$(date)] [$task_id] ç³»ç»Ÿèµ„æºä¸è¶³ï¼Œä»»åŠ¡å»¶è¿Ÿ" >> $LOG_FILE
        return 2
    fi
    
    # 3. é€‰æ‹©å‹ç¼©å·¥å…·
    local tool_info=$(select_compression_tool "$source_file" "balanced")
    local tool=$(echo "$tool_info" | cut -d'|' -f1)
    local reason=$(echo "$tool_info" | cut -d'|' -f2)
    
    if [ "$tool" = "skip" ]; then
        echo "[$(date)] [$task_id] è·³è¿‡å‹ç¼©: $source_file - $reason" >> $LOG_FILE
        return 0
    fi
    
    echo "[$(date)] [$task_id] é€‰æ‹©å‹ç¼©å·¥å…·: $tool - $reason" >> $LOG_FILE
    
    # 4. æ‰§è¡Œå‹ç¼©
    local compressed_file
    case "$tool" in
        "gzip")
            compressed_file="${source_file}.gz"
            if gzip -6 -c "$source_file" > "$compressed_file"; then
                echo "[$(date)] [$task_id] GZIPå‹ç¼©å®Œæˆ" >> $LOG_FILE
            else
                echo "[$(date)] [$task_id] GZIPå‹ç¼©å¤±è´¥" >> $LOG_FILE
                rm -f "$compressed_file"
                return 1
            fi
            ;;
        "xz")
            compressed_file="${source_file}.xz"
            if xz -6 -c "$source_file" > "$compressed_file"; then
                echo "[$(date)] [$task_id] XZå‹ç¼©å®Œæˆ" >> $LOG_FILE
            else
                echo "[$(date)] [$task_id] XZå‹ç¼©å¤±è´¥" >> $LOG_FILE
                rm -f "$compressed_file"
                return 1
            fi
            ;;
        "bzip2")
            compressed_file="${source_file}.bz2"
            if bzip2 -6 -c "$source_file" > "$compressed_file"; then
                echo "[$(date)] [$task_id] BZIP2å‹ç¼©å®Œæˆ" >> $LOG_FILE
            else
                echo "[$(date)] [$task_id] BZIP2å‹ç¼©å¤±è´¥" >> $LOG_FILE
                rm -f "$compressed_file"
                return 1
            fi
            ;;
        *)
            echo "[$(date)] [$task_id] é”™è¯¯ï¼šä¸æ”¯æŒçš„å‹ç¼©å·¥å…· $tool" >> $LOG_FILE
            return 1
            ;;
    esac
    
    # 5. å®Œæ•´æ€§éªŒè¯
    if ! verify_compressed_file "$compressed_file" "$tool"; then
        echo "[$(date)] [$task_id] å‹ç¼©æ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥" >> $LOG_FILE
        rm -f "$compressed_file"
        return 1
    fi
    
    # 6. æ¸…ç†åŸæ–‡ä»¶ï¼ˆå¦‚æœé…ç½®å…è®¸ï¼‰
    local delete_original=$(grep "delete_original_after_compress=" "$CONFIG_FILE" | cut -d'=' -f2)
    if [ "$delete_original" = "true" ]; then
        rm "$source_file"
        echo "[$(date)] [$task_id] åŸæ–‡ä»¶å·²åˆ é™¤: $source_file" >> $LOG_FILE
    fi
    
    echo "[$(date)] [$task_id] æ ‡å‡†åŒ–å‹ç¼©å®Œæˆ: $compressed_file" >> $LOG_FILE
    return 0
}

# æ–‡ä»¶é¢„æ£€æŸ¥
precheck_file() {
    local file_path=$1
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if [ ! -f "$file_path" ]; then
        echo "æ–‡ä»¶ä¸å­˜åœ¨: $file_path"
        return 1
    fi
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯è¯»
    if [ ! -r "$file_path" ]; then
        echo "æ–‡ä»¶ä¸å¯è¯»: $file_path"
        return 1
    fi
    
    # æ£€æŸ¥ç›®å½•æ˜¯å¦å¯å†™
    if [ ! -w "$(dirname "$file_path")" ]; then
        echo "ç›®å½•ä¸å¯å†™: $(dirname "$file_path")"
        return 1
    fi
    
    # æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨å‹ç¼©æ–‡ä»¶
    if [ -f "${file_path}.gz" ] || [ -f "${file_path}.xz" ] || [ -f "${file_path}.bz2" ]; then
        echo "å‹ç¼©æ–‡ä»¶å·²å­˜åœ¨"
        return 1
    fi
    
    return 0
}

# ç³»ç»Ÿèµ„æºæ£€æŸ¥
check_system_resources() {
    local max_load=$(grep "max_load_threshold=" "$CONFIG_FILE" | cut -d'=' -f2)
    local min_disk=$(grep "min_disk_space_mb=" "$CONFIG_FILE" | cut -d'=' -f2)
    local min_memory=$(grep "min_memory_mb=" "$CONFIG_FILE" | cut -d'=' -f2)
    
    # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
    local current_load=$(uptime | awk '{print $3}' | cut -d',' -f1)
    if (( $(echo "$current_load > $max_load" | bc -l) )); then
        echo "ç³»ç»Ÿè´Ÿè½½è¿‡é«˜: $current_load > $max_load"
        return 1
    fi
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    local available_space=$(df "$TEMP_DIR" | awk 'NR==2 {print int($4/1024)}')  # MB
    if [ "$available_space" -lt "$min_disk" ]; then
        echo "ç£ç›˜ç©ºé—´ä¸è¶³: ${available_space}MB < ${min_disk}MB"
        return 1
    fi
    
    # æ£€æŸ¥å¯ç”¨å†…å­˜
    local available_memory=$(free -m | awk 'NR==2{print $7}')
    if [ "$available_memory" -lt "$min_memory" ]; then
        echo "å†…å­˜ä¸è¶³: ${available_memory}MB < ${min_memory}MB"
        return 1
    fi
    
    return 0
}

# å‹ç¼©æ–‡ä»¶å®Œæ•´æ€§éªŒè¯
verify_compressed_file() {
    local compressed_file=$1
    local tool=$2
    
    case "$tool" in
        "gzip")
            gzip -t "$compressed_file" 2>/dev/null
            ;;
        "xz")
            xz -t "$compressed_file" 2>/dev/null
            ;;
        "bzip2")
            bzip2 -t "$compressed_file" 2>/dev/null
            ;;
        *)
            echo "æœªçŸ¥å‹ç¼©å·¥å…·ï¼Œæ— æ³•éªŒè¯"
            return 1
            ;;
    esac
}

# ä¸»ç¨‹åºå…¥å£
main() {
    local source_file=$1
    
    if [ -z "$source_file" ]; then
        echo "ç”¨æ³•: $0 <æºæ–‡ä»¶>"
        exit 1
    fi
    
    # åŠ è½½é…ç½®
    load_config
    
    # æ‰§è¡Œæ ‡å‡†åŒ–å‹ç¼©
    case $? in
        0)
            echo "å‹ç¼©æˆåŠŸ: $source_file"
            ;;
        1)
            echo "å‹ç¼©å¤±è´¥: $source_file"
            exit 1
            ;;
        2)
            echo "ç³»ç»Ÿèµ„æºä¸è¶³ï¼Œä»»åŠ¡å·²å»¶è¿Ÿ"
            exit 2
            ;;
    esac
}

# å¦‚æœç›´æ¥æ‰§è¡Œè„šæœ¬
if [ "${BASH_SOURCE[0]}" = "${0}" ]; then
    main "$@"
fi
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 ç”Ÿäº§ç¯å¢ƒå‹ç¼©çš„æ ¸å¿ƒåŸåˆ™


> ğŸ¯ **æ ¸å¿ƒç†å¿µ**ï¼šç”Ÿäº§ç¯å¢ƒçš„å‹ç¼©æ“ä½œå¿…é¡»åœ¨ä¿éšœä¸šåŠ¡ç¨³å®šæ€§çš„å‰æä¸‹ï¼Œå®ç°å­˜å‚¨ç©ºé—´çš„æœ€å¤§åŒ–åˆ©ç”¨ã€‚

**å…³é”®æˆåŠŸè¦ç´ **ï¼š
- **ğŸ“Š èµ„æºç›‘æ§**ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿèµ„æºï¼Œé¿å…å½±å“ä¸šåŠ¡è¿è¡Œ
- **â° åˆç†è°ƒåº¦**ï¼šé€‰æ‹©æœ€ä½³æ—¶é—´çª—å£æ‰§è¡Œå‹ç¼©ä»»åŠ¡
- **ğŸ”„ å¯é é‡è¯•**ï¼šå»ºç«‹å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **ğŸ“ æ ‡å‡†åŒ–**ï¼šåˆ¶å®šç»Ÿä¸€çš„å·¥å…·é€‰æ‹©å’Œæ“ä½œè§„èŒƒ

### 9.2 æœ€ä½³å®è·µæ¸…å•


**ğŸ“‹ è¿ç»´æ£€æŸ¥æ¸…å•**ï¼š
- [ ] **logrotateé…ç½®**ï¼šæ˜¯å¦å·²é…ç½®è‡ªåŠ¨æ—¥å¿—è½®è½¬å’Œå‹ç¼©
- [ ] **èµ„æºç›‘æ§**ï¼šæ˜¯å¦éƒ¨ç½²äº†å‹ç¼©æ“ä½œçš„èµ„æºç›‘æ§
- [ ] **ç½‘ç»œä¼˜åŒ–**ï¼šæ˜¯å¦æ ¹æ®ç½‘ç»œæ¡ä»¶é€‰æ‹©åˆé€‚çš„å‹ç¼©ç­–ç•¥
- [ ] **æ‰¹é‡å¤„ç†**ï¼šæ˜¯å¦å®ç°äº†æ™ºèƒ½çš„æ‰¹é‡å‹ç¼©ç®¡ç†
- [ ] **å¹¶å‘æ§åˆ¶**ï¼šæ˜¯å¦è®¾ç½®äº†åˆç†çš„å¹¶å‘ä»»åŠ¡æ•°é‡
- [ ] **è°ƒåº¦ç­–ç•¥**ï¼šæ˜¯å¦åˆ¶å®šäº†åŸºäºä¸šåŠ¡æ—¶æ®µçš„è°ƒåº¦ç­–ç•¥
- [ ] **é”™è¯¯å¤„ç†**ï¼šæ˜¯å¦å»ºç«‹äº†å®Œå–„çš„å¤±è´¥é‡è¯•æœºåˆ¶
- [ ] **å·¥å…·é€‰æ‹©**ï¼šæ˜¯å¦æœ‰æ ‡å‡†åŒ–çš„å‹ç¼©å·¥å…·é€‰æ‹©è§„èŒƒ

### 9.3 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹


| ä¼˜åŒ–æ–¹é¢ | **å…³é”®ç­–ç•¥** | **å®æ–½å»ºè®®** |
|---------|------------|-------------|
| **CPUä½¿ç”¨** | `è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦` | `æ ¹æ®CPUè´Ÿè½½åŠ¨æ€è°ƒæ•´å¹¶å‘æ•°` |
| **å†…å­˜ç®¡ç†** | `åˆ†å—å¤„ç†å¤§æ–‡ä»¶` | `é¿å…å¤§æ–‡ä»¶ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜` |
| **ç£ç›˜I/O** | `é”™å³°æ‰§è¡Œ` | `åœ¨ç£ç›˜I/Oè¾ƒä½æ—¶æ®µæ‰§è¡Œå‹ç¼©` |
| **ç½‘ç»œä¼ è¾“** | `è‡ªé€‚åº”å‹ç¼©` | `æ ¹æ®å¸¦å®½é€‰æ‹©å‹ç¼©çº§åˆ«` |

### 9.4 æ•…éšœé¢„é˜²ä¸åº”å¯¹


**ğŸ”§ å¸¸è§é—®é¢˜é¢„é˜²**ï¼š
```
é¢„é˜²æªæ–½çŸ©é˜µï¼š

ç£ç›˜ç©ºé—´ä¸è¶³ â†’ ç›‘æ§ç£ç›˜ä½¿ç”¨ç‡ + é¢„ç•™å®‰å…¨ç©ºé—´
å†…å­˜è€—å°½     â†’ é™åˆ¶å¹¶å‘æ•°é‡ + åˆ†å—å¤„ç†
æƒé™é—®é¢˜     â†’ æ ‡å‡†åŒ–æƒé™è®¾ç½® + å®šæœŸæ£€æŸ¥
ç½‘ç»œä¸­æ–­     â†’ æ–­ç‚¹ç»­ä¼ æœºåˆ¶ + é‡è¯•ç­–ç•¥
```

**âš ï¸ åº”æ€¥å¤„ç†æµç¨‹**ï¼š
1. **ç«‹å³åœæ­¢**ï¼šåœæ­¢æ‰€æœ‰å‹ç¼©ä»»åŠ¡ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æº
2. **é—®é¢˜å®šä½**ï¼šæŸ¥çœ‹æ—¥å¿—ï¼Œç¡®å®šæ•…éšœåŸå› 
3. **ç³»ç»Ÿæ¢å¤**ï¼šæ¢å¤ç³»ç»Ÿæ­£å¸¸çŠ¶æ€ï¼Œæ¸…ç†ä¸´æ—¶æ–‡ä»¶
4. **ä»»åŠ¡é‡å¯**ï¼šä½¿ç”¨æ›´ä¿å®ˆçš„å‚æ•°é‡æ–°å¯åŠ¨ä»»åŠ¡

### 9.5 å®æ–½å»ºè®®


**ğŸ“ˆ åˆ†é˜¶æ®µå®æ–½è·¯å¾„**ï¼š
```
ç¬¬ä¸€é˜¶æ®µ (åŸºç¡€å»ºè®¾):
â”œâ”€â”€ éƒ¨ç½²èµ„æºç›‘æ§ç³»ç»Ÿ
â”œâ”€â”€ é…ç½®logrotateè‡ªåŠ¨å‹ç¼©
â”œâ”€â”€ å»ºç«‹åŸºæœ¬çš„é”™è¯¯æ—¥å¿—è®°å½•
â””â”€â”€ åˆ¶å®šåˆç‰ˆå‹ç¼©å·¥å…·é€‰æ‹©è§„èŒƒ

ç¬¬äºŒé˜¶æ®µ (åŠŸèƒ½å®Œå–„):  
â”œâ”€â”€ å®ç°æ™ºèƒ½è°ƒåº¦ç³»ç»Ÿ
â”œâ”€â”€ éƒ¨ç½²æ‰¹é‡å‹ç¼©ç®¡ç†
â”œâ”€â”€ å»ºç«‹å®Œæ•´çš„é‡è¯•æœºåˆ¶
â””â”€â”€ ä¼˜åŒ–ç½‘ç»œä¼ è¾“ç­–ç•¥

ç¬¬ä¸‰é˜¶æ®µ (é«˜çº§ä¼˜åŒ–):
â”œâ”€â”€ å®ç°åŠ¨æ€è´Ÿè½½å‡è¡¡
â”œâ”€â”€ éƒ¨ç½²é¢„æµ‹æ€§èµ„æºè°ƒåº¦  
â”œâ”€â”€ å»ºç«‹è‡ªåŠ¨åŒ–æ•…éšœå¤„ç†
â””â”€â”€ å®ç°è·¨æ•°æ®ä¸­å¿ƒå‹ç¼©ä¼ è¾“
```

> ğŸ’¡ **å…³é”®æé†’**ï¼š
> 
> - ç”Ÿäº§ç¯å¢ƒå®æ–½å‰å¿…é¡»åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
> - æ‰€æœ‰è‡ªåŠ¨åŒ–è„šæœ¬éƒ½è¦æœ‰æ‰‹åŠ¨åœæ­¢æœºåˆ¶
> - å…³é”®ä¸šåŠ¡æ—¶æ®µé¿å…æ‰§è¡Œå¤§è§„æ¨¡å‹ç¼©æ“ä½œ
> - å®šæœŸå›é¡¾å’Œä¼˜åŒ–å‹ç¼©ç­–ç•¥ï¼Œé€‚åº”ä¸šåŠ¡å˜åŒ–

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ç›‘æ§å…ˆè¡Œä¿ç¨³å®šï¼Œè°ƒåº¦åˆç†é¿å†²çª
- æ‰¹é‡æ™ºèƒ½ææ•ˆç‡ï¼Œé‡è¯•æœºåˆ¶ä¿å¯é   
- å·¥å…·é€‰æ‹©è¦æ ‡å‡†ï¼Œèµ„æºæ§åˆ¶æ˜¯å…³é”®
- ç”Ÿäº§å®æ–½éœ€è°¨æ…ï¼Œæµ‹è¯•éªŒè¯ä¸å¯å°‘