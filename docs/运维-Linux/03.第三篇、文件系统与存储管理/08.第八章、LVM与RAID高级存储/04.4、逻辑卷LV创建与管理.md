---
title: 4、逻辑卷LV创建与管理
---
## 📚 目录

1. [逻辑卷基本概念](#1-逻辑卷基本概念)
2. [创建逻辑卷lvcreate](#2-创建逻辑卷lvcreate)
3. [查看逻辑卷信息](#3-查看逻辑卷信息)
4. [调整逻辑卷大小](#4-调整逻辑卷大小)
5. [删除逻辑卷操作](#5-删除逻辑卷操作)
6. [逻辑卷重命名管理](#6-逻辑卷重命名管理)
7. [高级逻辑卷配置](#7-高级逻辑卷配置)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 📦 逻辑卷基本概念


### 1.1 什么是逻辑卷（LV）


**💡 通俗理解**：
逻辑卷就像是从"存储池"中分出来的一个个"虚拟硬盘"。想象一下：
- 卷组（VG）= 一个大水池
- 逻辑卷（LV）= 从水池中用管子引出的各个水龙头
- 每个水龙头可以调节流量大小，就像调整逻辑卷的容量

```
物理硬盘关系图示：
物理硬盘 → 物理卷(PV) → 卷组(VG) → 逻辑卷(LV) → 文件系统

/dev/sda1 ────┐
              ├─→ 卷组vg1 ────┬─→ 逻辑卷lv1 (根分区)
/dev/sdb1 ────┘              ├─→ 逻辑卷lv2 (home分区)
                              └─→ 逻辑卷lv3 (var分区)
```

**🎯 逻辑卷的核心特点**：
- **灵活性**：可以随时调整大小，不受物理硬盘限制
- **跨设备**：一个逻辑卷可以跨越多个物理硬盘
- **动态管理**：在线扩容缩容，不需要停机
- **统一管理**：多个硬盘当作一个整体来使用

### 1.2 逻辑卷在LVM中的作用


```
LVM层次结构详解：

┌─────────────────┐
│   文件系统       │  ← 用户看到的最终存储空间
├─────────────────┤
│   逻辑卷(LV)    │  ← 虚拟的存储设备，可动态调整
├─────────────────┤
│   卷组(VG)      │  ← 存储资源池，管理所有空间
├─────────────────┤
│   物理卷(PV)    │  ← 实际的硬盘或分区
└─────────────────┘
```

**🔍 逻辑卷的实际意义**：
- **对用户**：就像一个普通的硬盘分区，可以格式化、挂载
- **对系统**：是一个虚拟的块设备，路径如 `/dev/vg1/lv1`
- **对管理员**：是灵活的存储单位，可以随需调整

---

## 2. 🛠️ 创建逻辑卷lvcreate


### 2.1 lvcreate命令基本语法


**📝 命令格式**：
```bash
lvcreate [选项] -L 大小 -n 逻辑卷名 卷组名
lvcreate [选项] -l 百分比 -n 逻辑卷名 卷组名
```

**🔧 核心参数详解**：

| 参数 | 含义 | 示例 |
|------|------|------|
| **-L** | 指定逻辑卷大小（绝对值） | `-L 10G` = 10GB |
| **-l** | 指定逻辑卷大小（百分比/PE数量） | `-l 50%VG` = 使用VG的50% |
| **-n** | 逻辑卷名称 | `-n mylv` |
| **-s** | 创建快照卷 | `-s` |
| **-m** | 创建镜像卷 | `-m 1` = 1个镜像 |
| **-i** | 条带化数量 | `-i 2` = 2个条带 |

### 2.2 创建基本逻辑卷


**🎯 创建固定大小的逻辑卷**：
```bash
# 创建10GB的逻辑卷
sudo lvcreate -L 10G -n home_lv vg1

# 创建500MB的逻辑卷
sudo lvcreate -L 500M -n temp_lv vg1

# 使用完整路径创建
sudo lvcreate -L 5G -n data_lv /dev/vg1
```

**📊 使用百分比创建逻辑卷**：
```bash
# 使用卷组50%的空间
sudo lvcreate -l 50%VG -n data_lv vg1

# 使用卷组全部剩余空间
sudo lvcreate -l 100%FREE -n backup_lv vg1

# 使用指定数量的PE（物理扩展）
sudo lvcreate -l 256 -n test_lv vg1
```

**💻 实际创建示例**：
```bash
# 检查卷组状态
$ sudo vgdisplay vg1
  --- Volume group ---
  VG Name               vg1
  System ID
  Format                lvm2
  VG Access             read/write
  VG Status             resizable
  VG Size               <20.00 GiB
  PE Size               4.00 MiB
  Total PE              5119
  Alloc PE              0
  Free  PE              5119

# 创建逻辑卷
$ sudo lvcreate -L 8G -n root_lv vg1
  Logical volume "root_lv" created.

# 验证创建结果
$ sudo lvs
  LV      VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root_lv vg1 -wi-a----- 8.00g
```

### 2.3 创建后的必要操作


**🔧 格式化和挂载**：
```bash
# 1. 格式化逻辑卷
sudo mkfs.ext4 /dev/vg1/root_lv

# 2. 创建挂载点
sudo mkdir /mnt/mylv

# 3. 挂载逻辑卷
sudo mount /dev/vg1/root_lv /mnt/mylv

# 4. 检查挂载状态
df -h /mnt/mylv
```

**📝 永久挂载配置**：
```bash
# 编辑fstab文件实现开机自动挂载
echo "/dev/vg1/root_lv /mnt/mylv ext4 defaults 0 2" >> /etc/fstab
```

---

## 3. 👀 查看逻辑卷信息


### 3.1 lvdisplay详细信息查看


**🔍 查看所有逻辑卷详细信息**：
```bash
sudo lvdisplay
```

**📊 输出示例解读**：
```bash
$ sudo lvdisplay
  --- Logical volume ---
  LV Path                /dev/vg1/root_lv          ← 逻辑卷的设备路径
  LV Name                root_lv                   ← 逻辑卷名称
  VG Name                vg1                       ← 所属卷组
  LV UUID                abc123-def4-ghi7-jkl8    ← 唯一标识符
  LV Write Access        read/write                ← 读写权限
  LV Creation host       localhost                 ← 创建的主机
  LV Status              available                 ← 可用状态
  # open                 1                         ← 当前打开数
  LV Size                8.00 GiB                 ← 逻辑卷大小
  Current LE             2048                      ← 当前逻辑扩展数
  Segments               1                         ← 段数量
  Allocation             inherit                   ← 分配策略
  Read ahead sectors     auto                      ← 预读扇区
  - currently set to     256                       ← 当前预读值
  Block device           253:0                     ← 块设备号
```

**🎯 查看指定逻辑卷**：
```bash
# 查看特定逻辑卷
sudo lvdisplay /dev/vg1/root_lv

# 或者使用卷组名/逻辑卷名格式
sudo lvdisplay vg1/root_lv
```

### 3.2 lvs简洁信息查看


**📋 基本信息查看**：
```bash
# 查看所有逻辑卷简要信息
sudo lvs

# 查看指定卷组的逻辑卷
sudo lvs vg1
```

**🔧 自定义显示字段**：
```bash
# 显示指定字段
sudo lvs -o lv_name,vg_name,lv_size,lv_attr

# 显示更多详细信息
sudo lvs -v

# 以树状结构显示
sudo lvs --tree
```

**📊 常用显示格式**：
```bash
$ sudo lvs
  LV      VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root_lv vg1 -wi-a----- 8.00g
  home_lv vg1 -wi-a----- 5.00g
  swap_lv vg1 -wi-a----- 2.00g
```

**💡 属性字段含义**：
```
Attr字段解释（以-wi-a-----为例）：
第1位：卷类型（- = 普通卷，s = 快照，m = 镜像）
第2位：权限（w = 可写，r = 只读）
第3位：分配策略（i = inherit继承）
第4位：固定minor号（- = 未固定，m = 固定）
第5位：状态（a = 活动，- = 非活动）
第6位：设备状态（- = 正常）
...
```

---

## 4. 📏 调整逻辑卷大小


### 4.1 扩展逻辑卷（lvextend）


**🔍 为什么要扩展逻辑卷**：
当存储空间不够用时，传统分区需要备份数据、重新分区、恢复数据。而LVM可以直接在线扩展，无需停机。

**📈 基本扩展操作**：
```bash
# 扩展到指定总大小
sudo lvextend -L 15G /dev/vg1/root_lv

# 扩展指定增量大小
sudo lvextend -L +5G /dev/vg1/root_lv

# 扩展到卷组剩余空间的50%
sudo lvextend -l +50%FREE /dev/vg1/root_lv

# 扩展到卷组全部剩余空间
sudo lvextend -l +100%FREE /dev/vg1/root_lv
```

**🔧 同步扩展文件系统**：
```bash
# 方式1：扩展逻辑卷时同时扩展文件系统
sudo lvextend -L +5G -r /dev/vg1/root_lv

# 方式2：先扩展逻辑卷，再手动扩展文件系统
sudo lvextend -L +5G /dev/vg1/root_lv
sudo resize2fs /dev/vg1/root_lv    # ext2/3/4文件系统
# 或
sudo xfs_growfs /mnt/mylv          # XFS文件系统
```

**💻 完整扩展示例**：
```bash
# 1. 检查当前状态
$ df -h /mnt/mylv
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/vg1-root_lv  8.0G  1.2G  6.4G  16% /mnt/mylv

# 2. 检查卷组剩余空间
$ sudo vgs
  VG  #PV #LV #SN Attr   VSize   VFree
  vg1   2   1   0 wz--n- <20.00g  12.00g

# 3. 扩展逻辑卷
$ sudo lvextend -L +5G -r /dev/vg1/root_lv
  Size of logical volume vg1/root_lv changed from 8.00 GiB to 13.00 GiB.
  Logical volume vg1/root_lv successfully resized.
  resize2fs 1.44.1
  Resizing filesystem on /dev/mapper/vg1-root_lv to 3407872 blocks.

# 4. 验证结果
$ df -h /mnt/mylv
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/vg1-root_lv  13G  1.2G   11G  10% /mnt/mylv
```

### 4.2 缩小逻辑卷（lvreduce）


> ⚠️ **重要警告**：缩小逻辑卷有数据丢失风险，务必先备份数据！

**🔍 缩小的基本原理**：
缩小逻辑卷需要先缩小文件系统，再缩小逻辑卷。顺序不能颠倒！

**📉 缩小操作步骤**：
```bash
# 1. 卸载文件系统
sudo umount /mnt/mylv

# 2. 检查文件系统
sudo fsck -f /dev/vg1/root_lv

# 3. 缩小文件系统到8G
sudo resize2fs /dev/vg1/root_lv 8G

# 4. 缩小逻辑卷到8G
sudo lvreduce -L 8G /dev/vg1/root_lv

# 5. 重新挂载
sudo mount /dev/vg1/root_lv /mnt/mylv
```

**⚠️ 安全缩小示例**：
```bash
# 使用交互式确认缩小
$ sudo lvreduce -L 8G /dev/vg1/root_lv
  WARNING: Reducing active logical volume to 8.00 GiB.
  THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce vg1/root_lv? [y/n]: y
  Size of logical volume vg1/root_lv changed from 13.00 GiB to 8.00 GiB.
  Logical volume vg1/root_lv successfully resized.

# 强制缩小（不推荐，除非你确定知道在做什么）
sudo lvreduce -L 8G -f /dev/vg1/root_lv
```

### 4.3 调整大小的最佳实践


**💡 扩展最佳实践**：
- ✅ 先检查卷组剩余空间是否足够
- ✅ 使用 `-r` 参数同时扩展文件系统
- ✅ 可以在线扩展，无需卸载
- ✅ 扩展操作相对安全，很少出错

**⚠️ 缩小注意事项**：
- ❗ 必须先备份重要数据
- ❗ 必须先卸载文件系统
- ❗ 必须先缩小文件系统，再缩小逻辑卷
- ❗ 缩小后的空间必须能容纳所有数据
- ❗ XFS文件系统不支持缩小操作

---

## 5. 🗑️ 删除逻辑卷操作


### 5.1 lvremove删除逻辑卷


**🔍 删除的基本原理**：
删除逻辑卷会释放所有占用的空间回到卷组，但数据将永久丢失。

**📝 删除操作步骤**：
```bash
# 1. 卸载文件系统
sudo umount /mnt/mylv

# 2. 删除逻辑卷
sudo lvremove /dev/vg1/root_lv

# 或使用卷组/逻辑卷格式
sudo lvremove vg1/root_lv
```

**💻 删除操作示例**：
```bash
# 查看当前逻辑卷
$ sudo lvs
  LV      VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root_lv vg1 -wi-a----- 8.00g
  temp_lv vg1 -wi------- 1.00g

# 删除未挂载的逻辑卷
$ sudo lvremove vg1/temp_lv
Do you really want to remove active logical volume vg1/temp_lv? [y/n]: y
  Logical volume "temp_lv" successfully removed

# 尝试删除已挂载的逻辑卷（会失败）
$ sudo lvremove vg1/root_lv
  Can't remove open logical volume "vg1/root_lv"

# 先卸载再删除
$ sudo umount /mnt/mylv
$ sudo lvremove vg1/root_lv
Do you really want to remove active logical volume vg1/root_lv? [y/n]: y
  Logical volume "root_lv" successfully removed
```

### 5.2 强制删除和批量删除


**🔧 强制删除选项**：
```bash
# 强制删除，不询问确认
sudo lvremove -f vg1/temp_lv

# 删除所有逻辑卷（极其危险！）
sudo lvremove vg1
```

**📋 删除前的检查清单**：
- [ ] 确认数据已备份
- [ ] 确认文件系统已卸载
- [ ] 确认没有其他进程在使用该逻辑卷
- [ ] 确认删除后不会影响系统运行

### 5.3 删除相关的清理工作


**🧹 完整清理示例**：
```bash
# 1. 从/etc/fstab中移除挂载记录
sudo sed -i '/\/dev\/vg1\/root_lv/d' /etc/fstab

# 2. 删除挂载点目录
sudo rmdir /mnt/mylv

# 3. 检查卷组空间释放情况
sudo vgs
  VG  #PV #LV #SN Attr   VSize   VFree
  vg1   2   0   0 wz--n- <20.00g <20.00g  ← 空间已释放
```

---

## 6. 🏷️ 逻辑卷重命名管理


### 6.1 lvrename重命名逻辑卷


**🔍 为什么需要重命名**：
- 更符合命名规范
- 反映逻辑卷的实际用途
- 避免名称冲突
- 便于管理和维护

**📝 重命名基本语法**：
```bash
# 方式1：指定卷组和新旧名称
sudo lvrename 卷组名 旧名称 新名称

# 方式2：使用完整路径
sudo lvrename /dev/卷组名/旧名称 /dev/卷组名/新名称
```

**💻 重命名操作示例**：
```bash
# 查看当前逻辑卷
$ sudo lvs
  LV      VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  temp_lv vg1 -wi-a----- 5.00g

# 重命名逻辑卷
$ sudo lvrename vg1 temp_lv data_lv
  Renamed "temp_lv" to "data_lv" in volume group "vg1"

# 验证重命名结果
$ sudo lvs
  LV      VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  data_lv vg1 -wi-a----- 5.00g

# 使用完整路径重命名
$ sudo lvrename /dev/vg1/data_lv /dev/vg1/backup_lv
  Renamed "data_lv" to "backup_lv" in volume group "vg1"
```

### 6.2 重命名后的配置更新


**🔧 更新系统配置**：
重命名后需要更新相关的配置文件，否则系统重启后可能无法正确挂载。

```bash
# 1. 更新/etc/fstab中的挂载记录
sudo sed -i 's/\/dev\/vg1\/temp_lv/\/dev\/vg1\/data_lv/g' /etc/fstab

# 2. 如果逻辑卷正在使用，需要重新挂载
sudo umount /mnt/temp
sudo mount /dev/vg1/data_lv /mnt/temp

# 3. 检查更新结果
grep data_lv /etc/fstab
```

**📋 重命名注意事项**：
- ✅ 可以在逻辑卷活动时重命名
- ✅ 重命名后设备路径会立即生效
- ⚠️ 需要更新所有相关配置文件
- ⚠️ 脚本中的硬编码路径需要修改

---

## 7. 🚀 高级逻辑卷配置


### 7.1 条带化逻辑卷创建


**🔍 什么是条带化**：
条带化就是把数据分散存储到多个物理设备上，就像把一本书的内容分别写在多个笔记本上，这样可以同时读写，提高性能。

```
条带化示例图：
数据块1 → PV1    数据块2 → PV2    数据块3 → PV1    数据块4 → PV2
     ↓              ↓              ↓              ↓
   磁盘A          磁盘B          磁盘A          磁盘B

优势：读写速度提升，因为可以并行操作多个磁盘
```

**📈 创建条带化逻辑卷**：
```bash
# 创建2个条带的逻辑卷，条带大小64KB
sudo lvcreate -L 10G -i 2 -I 64K -n stripe_lv vg1

# 创建3个条带的逻辑卷
sudo lvcreate -L 15G -i 3 -n fast_lv vg1

# 查看条带信息
sudo lvdisplay -m vg1/stripe_lv
```

**🔧 条带化参数说明**：

| 参数 | 含义 | 推荐值 |
|------|------|--------|
| **-i** | 条带数量 | 根据PV数量决定，通常2-4个 |
| **-I** | 条带大小 | 64K-1M，数据库建议64K |

### 7.2 镜像逻辑卷配置


**🔍 什么是镜像逻辑卷**：
镜像逻辑卷会把相同的数据同时写入多个物理设备，就像照镜子一样，确保数据的冗余备份。

```
镜像示例图：
写入数据 ──┬── PV1（主副本）
          └── PV2（镜像副本）

数据同时存储在两个位置，任何一个损坏都不影响数据安全
```

**🛡️ 创建镜像逻辑卷**：
```bash
# 创建1个镜像副本的逻辑卷
sudo lvcreate -L 8G -m 1 -n mirror_lv vg1

# 创建镜像逻辑卷并指定日志设备
sudo lvcreate -L 10G -m 1 --mirrorlog disk -n safe_lv vg1

# 查看镜像状态
sudo lvs -o +mirror_log,copy_percent vg1/mirror_lv
```

**📊 镜像参数详解**：

| 参数 | 含义 | 说明 |
|------|------|------|
| **-m 1** | 1个镜像副本 | 总共2份数据（原始+镜像） |
| **-m 2** | 2个镜像副本 | 总共3份数据 |
| **--mirrorlog disk** | 日志存储在磁盘 | 提高可靠性 |
| **--mirrorlog core** | 日志存储在内存 | 提高性能 |

### 7.3 快照逻辑卷


**🔍 什么是快照逻辑卷**：
快照就像给逻辑卷拍照，保存某一时刻的数据状态。当原数据改变时，快照仍保留原来的数据。

**📸 创建快照逻辑卷**：
```bash
# 为root_lv创建2G的快照
sudo lvcreate -L 2G -s -n root_lv_snap /dev/vg1/root_lv

# 创建快照时指定大小为原卷的20%
sudo lvcreate -l 20%ORIGIN -s -n backup_snap /dev/vg1/data_lv

# 查看快照状态
sudo lvs -o +snap_percent vg1
```

**🔧 快照的实际应用**：
```bash
# 1. 创建快照前的准备
sudo sync  # 同步数据到磁盘

# 2. 创建快照
sudo lvcreate -L 1G -s -n backup_snap /dev/vg1/root_lv

# 3. 挂载快照进行备份
sudo mkdir /mnt/snapshot
sudo mount /dev/vg1/backup_snap /mnt/snapshot

# 4. 执行备份操作
sudo tar czf /backup/system_backup.tar.gz /mnt/snapshot

# 5. 清理快照
sudo umount /mnt/snapshot
sudo lvremove /dev/vg1/backup_snap
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 逻辑卷本质：从卷组中分配的虚拟存储设备
🔸 创建命令：lvcreate -L 大小 -n 名称 卷组名
🔸 查看命令：lvdisplay（详细）、lvs（简洁）
🔸 大小调整：lvextend（扩展）、lvreduce（缩小）
🔸 删除命令：lvremove，注意先卸载文件系统
🔸 重命名：lvrename，需同步更新配置文件
```

### 8.2 关键操作流程


**🔹 创建逻辑卷的完整流程**：
```
1. 检查卷组空间 → sudo vgs
2. 创建逻辑卷 → sudo lvcreate -L 大小 -n 名称 VG名
3. 格式化文件系统 → sudo mkfs.ext4 /dev/VG名/LV名
4. 创建挂载点 → sudo mkdir /挂载点
5. 挂载使用 → sudo mount /dev/VG名/LV名 /挂载点
6. 配置自动挂载 → 编辑/etc/fstab
```

**🔹 安全删除逻辑卷的流程**：
```
1. 备份重要数据
2. 卸载文件系统 → sudo umount /挂载点
3. 从fstab删除记录 → 编辑/etc/fstab
4. 删除逻辑卷 → sudo lvremove /dev/VG名/LV名
5. 清理挂载点目录
```

### 8.3 实际应用指导


**💡 逻辑卷大小规划建议**：
- **根分区**：15-20GB，预留扩展空间
- **家目录**：根据用户数据量，建议50%VG空间
- **交换空间**：内存的1-2倍，或固定2-4GB
- **临时空间**：5-10GB，用于临时文件和缓存

**⚠️ 常见错误和避免方法**：
- ❗ **缩小前未缩小文件系统**：导致数据丢失
- ❗ **删除正在使用的逻辑卷**：先卸载再删除
- ❗ **重命名后未更新配置**：导致开机无法挂载
- ❗ **快照空间不足**：快照满了会自动失效

### 8.4 性能优化建议


**🚀 性能优化策略**：
- **条带化**：对于高I/O需求的应用，使用条带化提升性能
- **镜像**：对于关键数据，使用镜像确保可靠性
- **快照**：用于备份和测试，避免长期保留大快照
- **预分配**：根据应用增长预留足够空间，避免频繁扩展

**🔧 监控和维护**：
```bash
# 定期检查逻辑卷状态
sudo lvs -o +lv_health_status

# 监控空间使用情况
sudo df -h

# 检查快照使用率
sudo lvs -o +snap_percent

# 查看I/O统计
sudo iostat -x 1
```

**核心记忆口诀**：
- 创建逻辑卷：lvcreate指定大小和名称
- 查看状态：lvdisplay详细，lvs简洁
- 调整大小：扩展安全，缩小谨慎
- 删除操作：先卸载，后删除
- 重命名后：记得更新配置文件