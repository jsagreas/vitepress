---
title: 8ã€æ–‡ä»¶ç¼–ç ä¸å­—ç¬¦é›†æ£€æµ‹
---
## ğŸ“š ç›®å½•

1. [æ–‡ä»¶ç¼–ç åŸºç¡€æ¦‚å¿µ](#1-æ–‡ä»¶ç¼–ç åŸºç¡€æ¦‚å¿µ)
2. [å­—ç¬¦ç¼–ç æ£€æµ‹å·¥å…·](#2-å­—ç¬¦ç¼–ç æ£€æµ‹å·¥å…·)
3. [ç¼–ç è½¬æ¢å®æˆ˜æ“ä½œ](#3-ç¼–ç è½¬æ¢å®æˆ˜æ“ä½œ)
4. [å¤šå­—èŠ‚å­—ç¬¦å¤„ç†](#4-å¤šå­—èŠ‚å­—ç¬¦å¤„ç†)
5. [æ‰¹é‡ç¼–ç è½¬æ¢æ–¹æ¡ˆ](#5-æ‰¹é‡ç¼–ç è½¬æ¢æ–¹æ¡ˆ)
6. [ç¼–ç é—®é¢˜è¯Šæ–­ä¸ä¿®å¤](#6-ç¼–ç é—®é¢˜è¯Šæ–­ä¸ä¿®å¤)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“– æ–‡ä»¶ç¼–ç åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å­—ç¬¦ç¼–ç 


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> å­—ç¬¦ç¼–ç å°±åƒæ˜¯è®¡ç®—æœºå’Œäººç±»ä¹‹é—´çš„"ç¿»è¯‘å®˜"ï¼ŒæŠŠæˆ‘ä»¬èƒ½çœ‹æ‡‚çš„æ–‡å­—è½¬æ¢æˆè®¡ç®—æœºèƒ½å¤„ç†çš„æ•°å­—ï¼Œå†è½¬æ¢å›æ¥ç»™æˆ‘ä»¬çœ‹ã€‚

**ğŸ”¸ åŸºç¡€æ¦‚å¿µ**
```
ç®€å•ç†è§£ï¼š
æ–‡å­— â†’ ç¼–ç  â†’ æ•°å­— â†’ å­˜å‚¨åˆ°æ–‡ä»¶
æ–‡ä»¶ â†’ æ•°å­— â†’ è§£ç  â†’ æ˜¾ç¤ºæ–‡å­—

å°±åƒè¿™æ ·ï¼š
"ä½ å¥½" â†’ UTF-8ç¼–ç  â†’ [228,189,160,229,165,189] â†’ ä¿å­˜
è¯»å–æ—¶ï¼š[228,189,160,229,165,189] â†’ UTF-8è§£ç  â†’ "ä½ å¥½"
```

**å¸¸è§ç¼–ç ç±»å‹å¯¹æ¯”**ï¼š

| ç¼–ç ç±»å‹ | **ç‰¹ç‚¹** | **ä½¿ç”¨åœºæ™¯** | **æ–‡ä»¶å¤§å°** |
|---------|----------|-------------|-------------|
| `UTF-8` | **ä¸‡èƒ½ç¼–ç ï¼Œæ”¯æŒæ‰€æœ‰è¯­è¨€** | ç½‘é¡µã€ç°ä»£ç³»ç»Ÿ | ä¸­æ–‡3å­—èŠ‚ |
| `GBK` | **ä¸“é—¨æ”¯æŒä¸­æ–‡** | è€ç‰ˆæœ¬Windows | ä¸­æ–‡2å­—èŠ‚ |
| `ASCII` | **åªæ”¯æŒè‹±æ–‡æ•°å­—ç¬¦å·** | çº¯è‹±æ–‡ç¯å¢ƒ | è‹±æ–‡1å­—èŠ‚ |
| `ISO-8859-1` | **æ”¯æŒè¥¿æ¬§è¯­è¨€** | æ¬§æ´²ç³»ç»Ÿ | 1å­—èŠ‚ |

### 1.2 ç¼–ç é—®é¢˜çš„è¡¨ç°


**ğŸ˜µ ä¹±ç ç°è±¡**
```
æ­£å¸¸æ˜¾ç¤ºï¼šä½ å¥½ä¸–ç•Œ
GBKè¯¯è¯»ä¸ºUTF-8ï¼šï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
UTF-8è¯¯è¯»ä¸ºGBKï¼šæµ£çŠ²ã‚½æ¶“æ «æ™«
```

**ğŸ¯ ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¹±ç ï¼Ÿ**
å°±åƒç”¨é”™äº†å­—å…¸ç¿»è¯‘å¤–è¯­ï¼š
- æ–‡ä»¶ç”¨GBKç¼–ç ä¿å­˜ï¼ˆç›¸å½“äºç”¨ä¸­æ–‡å­—å…¸å†™çš„ï¼‰
- ç¨‹åºç”¨UTF-8è§£ç è¯»å–ï¼ˆç›¸å½“äºç”¨è‹±æ–‡å­—å…¸è¯»ï¼‰
- ç»“æœå½“ç„¶è¯»ä¸å¯¹ï¼Œæ˜¾ç¤ºä¹±ç 

---

## 2. ğŸ” å­—ç¬¦ç¼–ç æ£€æµ‹å·¥å…·


### 2.1 chardetï¼šPythonå­—ç¬¦ç¼–ç ä¾¦æ¢


**ğŸ”¸ ä»€ä¹ˆæ˜¯chardet**
```bash
# chardetæ˜¯ä¸€ä¸ªæ™ºèƒ½ç¼–ç æ£€æµ‹å·¥å…·
# å°±åƒç¼–ç ç•Œçš„"ç¦å°”æ‘©æ–¯"ï¼Œèƒ½åˆ†ææ–‡ä»¶å†…å®¹çŒœå‡ºç¼–ç ç±»å‹
```

**ğŸ“‹ å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨**
```bash
# å®‰è£…chardet
pip install chardet
# æˆ–åœ¨æŸäº›ç³»ç»Ÿä¸Š
sudo apt install python3-chardet

# æ£€æµ‹å•ä¸ªæ–‡ä»¶ç¼–ç 
chardet myfile.txt

# æ£€æµ‹å¤šä¸ªæ–‡ä»¶
chardet *.txt

# åªæ˜¾ç¤ºç¼–ç ç»“æœï¼Œä¸æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
chardet --minimal myfile.txt
```

**ğŸ”§ å®é™…ä½¿ç”¨ç¤ºä¾‹**
```bash
$ chardet chinese_file.txt
chinese_file.txt: GB2312 with confidence 0.99

$ chardet japanese_file.txt  
japanese_file.txt: Shift_JIS with confidence 0.88

$ chardet mixed_files/*
doc1.txt: UTF-8 with confidence 0.99
doc2.txt: GBK with confidence 0.95
doc3.txt: ASCII with confidence 1.0
```

> **ğŸ’¡ ç½®ä¿¡åº¦è¯´æ˜**
> - 0.9-1.0ï¼šéå¸¸ç¡®å®šï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨
> - 0.7-0.9ï¼šæ¯”è¾ƒç¡®å®šï¼Œé€šå¸¸æ­£ç¡®
> - 0.5-0.7ï¼šä¸å¤ªç¡®å®šï¼Œéœ€è¦äººå·¥éªŒè¯
> - <0.5ï¼šå¾ˆä¸ç¡®å®šï¼Œå¯èƒ½æ£€æµ‹é”™è¯¯

### 2.2 fileå‘½ä»¤ï¼šç³»ç»Ÿå†…ç½®æ£€æµ‹å™¨


**ğŸ”¸ fileå‘½ä»¤çš„ç¼–ç æ£€æµ‹åŠŸèƒ½**
```bash
# æ£€æµ‹æ–‡ä»¶ç±»å‹å’Œç¼–ç 
file myfile.txt

# åªå…³æ³¨ç¼–ç ä¿¡æ¯
file -i myfile.txt
# æˆ–
file --mime myfile.txt
```

**ğŸ“ å®é™…ç¤ºä¾‹**
```bash
$ file chinese_doc.txt
chinese_doc.txt: UTF-8 Unicode text

$ file -i old_chinese.txt
old_chinese.txt: text/plain; charset=gb2312

$ file mixed_encoding/
mixed_encoding/readme.txt: ASCII text
mixed_encoding/è¯´æ˜.txt: UTF-8 Unicode text
mixed_encoding/legacy.txt: ISO-8859 text
```

### 2.3 encaï¼šä¸“ä¸šç¼–ç åˆ†æå·¥å…·


**ğŸ”¸ ä»€ä¹ˆæ˜¯enca**
```bash
# encaæ˜¯æ›´ä¸“ä¸šçš„ç¼–ç æ£€æµ‹å·¥å…·
# ç‰¹åˆ«é€‚åˆå¤„ç†ä¸œæ¬§è¯­è¨€ç¼–ç é—®é¢˜
sudo apt install enca  # Ubuntu/Debian
sudo yum install enca  # CentOS/RHEL
```

**ğŸ“‹ åŸºæœ¬ä½¿ç”¨æ–¹æ³•**
```bash
# æ£€æµ‹æ–‡ä»¶ç¼–ç 
enca -L zh myfile.txt    # æŒ‡å®šä¸­æ–‡ç¯å¢ƒ
enca -L ja myfile.txt    # æŒ‡å®šæ—¥æ–‡ç¯å¢ƒ
enca -L none myfile.txt  # ä¸æŒ‡å®šè¯­è¨€

# æ‰¹é‡æ£€æµ‹
enca -L zh *.txt

# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
enca -L zh -d myfile.txt
```

---

## 3. ğŸ”„ ç¼–ç è½¬æ¢å®æˆ˜æ“ä½œ


### 3.1 iconvï¼šç¼–ç è½¬æ¢ç‘å£«å†›åˆ€


**ğŸ”¸ iconvåŸºæœ¬æ¦‚å¿µ**
```
iconv = international conversionï¼ˆå›½é™…è½¬æ¢ï¼‰
åŠŸèƒ½ï¼šæŠŠä¸€ç§ç¼–ç çš„æ–‡ä»¶è½¬æ¢æˆå¦ä¸€ç§ç¼–ç 
è¯­æ³•ï¼šiconv -f æºç¼–ç  -t ç›®æ ‡ç¼–ç  è¾“å…¥æ–‡ä»¶ > è¾“å‡ºæ–‡ä»¶
```

**ğŸ“‹ å¸¸ç”¨è½¬æ¢æ“ä½œ**
```bash
# åŸºæœ¬è½¬æ¢è¯­æ³•
iconv -f GBK -t UTF-8 old_file.txt > new_file.txt

# å°±åœ°è½¬æ¢ï¼ˆè¦†ç›–åŸæ–‡ä»¶ï¼‰
iconv -f GBK -t UTF-8 myfile.txt -o myfile.txt

# æŸ¥çœ‹ç³»ç»Ÿæ”¯æŒçš„ç¼–ç 
iconv -l | head -20

# å¸¸ç”¨ç¼–ç è½¬æ¢ç¤ºä¾‹
iconv -f GB2312 -t UTF-8 chinese.txt > chinese_utf8.txt
iconv -f UTF-8 -t GBK input.txt > output.txt  
iconv -f ISO-8859-1 -t UTF-8 european.txt > european_utf8.txt
```

**âš ï¸ å¸¸è§é—®é¢˜å’Œè§£å†³**
```bash
# å¦‚æœè½¬æ¢æ—¶å‡ºé”™ï¼ŒåŠ ä¸Šé”™è¯¯å¤„ç†é€‰é¡¹
iconv -f GBK -t UTF-8//IGNORE input.txt > output.txt     # å¿½ç•¥é”™è¯¯å­—ç¬¦
iconv -f GBK -t UTF-8//TRANSLIT input.txt > output.txt   # éŸ³è¯‘æ— æ³•è½¬æ¢çš„å­—ç¬¦

# å¤„ç†ä¸ç¡®å®šç¼–ç çš„æ–‡ä»¶
chardet myfile.txt                    # å…ˆæ£€æµ‹ç¼–ç 
iconv -f GB2312 -t UTF-8 myfile.txt  # å†è½¬æ¢
```

### 3.2 å®é™…è½¬æ¢åœºæ™¯æ¼”ç¤º


**ğŸ“ åœºæ™¯1ï¼šWindowsæ–‡æ¡£è½¬Linux**
```bash
# ä»Windowså¤åˆ¶è¿‡æ¥çš„ä¸­æ–‡æ–‡æ¡£é€šå¸¸æ˜¯GBKç¼–ç 
# éœ€è¦è½¬æ¢ä¸ºUTF-8æ‰èƒ½åœ¨Linuxä¸‹æ­£å¸¸æ˜¾ç¤º

# æ­¥éª¤1ï¼šæ£€æµ‹ç¼–ç 
$ chardet windows_doc.txt
windows_doc.txt: GBK with confidence 0.95

# æ­¥éª¤2ï¼šè½¬æ¢ç¼–ç 
$ iconv -f GBK -t UTF-8 windows_doc.txt > linux_doc.txt

# æ­¥éª¤3ï¼šéªŒè¯ç»“æœ
$ file -i linux_doc.txt  
linux_doc.txt: text/plain; charset=utf-8
```

**ğŸ“ åœºæ™¯2ï¼šæ‰¹é‡è½¬æ¢æ—§æ–‡ä»¶**
```bash
# æœ‰ä¸€æ‰¹è€çš„GB2312æ–‡æ¡£éœ€è¦è½¬æ¢ä¸ºUTF-8

# åˆ›å»ºè½¬æ¢è„šæœ¬
#!/bin/bash
for file in *.txt; do
    echo "è½¬æ¢æ–‡ä»¶: $file"
    iconv -f GB2312 -t UTF-8 "$file" > "${file%.txt}_utf8.txt"
done

# æˆ–è€…ç”¨ä¸€è¡Œå‘½ä»¤è§£å†³
find . -name "*.txt" -exec sh -c 'iconv -f GB2312 -t UTF-8 "$1" > "${1%.txt}_utf8.txt"' _ {} \;
```

---

## 4. ğŸŒ å¤šå­—èŠ‚å­—ç¬¦å¤„ç†


### 4.1 ä»€ä¹ˆæ˜¯å¤šå­—èŠ‚å­—ç¬¦


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> å¤šå­—èŠ‚å­—ç¬¦å°±åƒæ˜¯"å¤æ‚æ±‰å­—"ï¼Œä¸€ä¸ªæ±‰å­—éœ€è¦ç”¨å¤šä¸ªå­—èŠ‚æ¥å­˜å‚¨ã€‚
> è‹±æ–‡å­—æ¯'A'åªéœ€è¦1ä¸ªå­—èŠ‚ï¼Œä½†ä¸­æ–‡'ä¸­'éœ€è¦2-3ä¸ªå­—èŠ‚ã€‚

**ğŸ”¸ å­—èŠ‚æ•°å¯¹æ¯”**
```
ASCIIå­—ç¬¦ï¼ˆè‹±æ–‡ï¼‰ï¼š  A = 1å­—èŠ‚
UTF-8ä¸­çš„æ±‰å­—ï¼š     ä¸­ = 3å­—èŠ‚ [228,184,173]
GBKä¸­çš„æ±‰å­—ï¼š      ä¸­ = 2å­—èŠ‚ [214,208]
```

**ğŸ“Š ç¼–ç æ–¹å¼çš„å­—èŠ‚ä½¿ç”¨**
```
æ–‡æœ¬: "Hello ä¸–ç•Œ"

ASCIIéƒ¨åˆ† "Hello ": 
UTF-8: [72,101,108,108,111,32] (6å­—èŠ‚)
GBK:   [72,101,108,108,111,32] (6å­—èŠ‚)

ä¸­æ–‡éƒ¨åˆ† "ä¸–ç•Œ":
UTF-8: [228,184,150,231,149,140] (6å­—èŠ‚ï¼Œæ¯ä¸ªæ±‰å­—3å­—èŠ‚)
GBK:   [202,192,189,231] (4å­—èŠ‚ï¼Œæ¯ä¸ªæ±‰å­—2å­—èŠ‚)
```

### 4.2 å¤šå­—èŠ‚å­—ç¬¦çš„å¤„ç†æŒ‘æˆ˜


**ğŸ¯ å¸¸è§é—®é¢˜**
```bash
# é—®é¢˜1ï¼šå­—ç¬¦æˆªæ–­
# å¦‚æœæŒ‰å­—èŠ‚æˆªå–ï¼Œå¯èƒ½æŠŠä¸€ä¸ªæ±‰å­—æˆªæˆä¸¤åŠ
echo "ä½ å¥½ä¸–ç•Œ" | cut -b 1-4  # å¯èƒ½æ˜¾ç¤ºä¹±ç 

# æ­£ç¡®æ–¹å¼ï¼šæŒ‰å­—ç¬¦æˆªå–
echo "ä½ å¥½ä¸–ç•Œ" | cut -c 1-2  # æ˜¾ç¤º"ä½ å¥½"
```

**ğŸ”§ å®‰å…¨çš„å¤šå­—èŠ‚å¤„ç†**
```bash
# ä½¿ç”¨localeç¡®ä¿æ­£ç¡®çš„å­—ç¬¦å¤„ç†
export LC_ALL=zh_CN.UTF-8

# ç»Ÿè®¡å­—ç¬¦æ•°è€Œä¸æ˜¯å­—èŠ‚æ•°
wc -m file.txt    # å­—ç¬¦æ•°
wc -c file.txt    # å­—èŠ‚æ•°

# å¤„ç†åŒ…å«ä¸­æ–‡çš„æ–‡ä»¶å
ls -1 | while IFS= read -r filename; do
    echo "å¤„ç†æ–‡ä»¶: $filename"
done
```

---

## 5. âš¡ æ‰¹é‡ç¼–ç è½¬æ¢æ–¹æ¡ˆ


### 5.1 ç®€å•æ‰¹é‡è½¬æ¢è„šæœ¬


**ğŸ”¸ åŸºç¡€æ‰¹é‡è½¬æ¢**
```bash
#!/bin/bash
# convert_encoding.sh - æ‰¹é‡ç¼–ç è½¬æ¢å·¥å…·

SOURCE_ENCODING="GBK"
TARGET_ENCODING="UTF-8"
FILE_PATTERN="*.txt"

echo "å¼€å§‹æ‰¹é‡è½¬æ¢ï¼š$SOURCE_ENCODING â†’ $TARGET_ENCODING"

for file in $FILE_PATTERN; do
    if [ -f "$file" ]; then
        echo "è½¬æ¢: $file"
        
        # åˆ›å»ºå¤‡ä»½
        cp "$file" "$file.bak"
        
        # æ‰§è¡Œè½¬æ¢
        iconv -f "$SOURCE_ENCODING" -t "$TARGET_ENCODING" "$file.bak" > "$file"
        
        # æ£€æŸ¥è½¬æ¢æ˜¯å¦æˆåŠŸ
        if [ $? -eq 0 ]; then
            echo "âœ… $file è½¬æ¢æˆåŠŸ"
            rm "$file.bak"  # åˆ é™¤å¤‡ä»½
        else
            echo "âŒ $file è½¬æ¢å¤±è´¥ï¼Œæ¢å¤å¤‡ä»½"
            mv "$file.bak" "$file"
        fi
    fi
done

echo "æ‰¹é‡è½¬æ¢å®Œæˆï¼"
```

### 5.2 æ™ºèƒ½æ£€æµ‹è½¬æ¢è„šæœ¬


**ğŸ”¸ è‡ªåŠ¨æ£€æµ‹ç¼–ç å¹¶è½¬æ¢**
```bash
#!/bin/bash
# smart_convert.sh - æ™ºèƒ½ç¼–ç æ£€æµ‹è½¬æ¢å·¥å…·

TARGET_ENCODING="UTF-8"

convert_file() {
    local file="$1"
    
    # æ£€æµ‹å½“å‰ç¼–ç 
    local detected=$(chardet "$file" | awk -F': ' '{print $2}' | awk '{print $1}')
    local confidence=$(chardet "$file" | grep -o 'confidence [0-9.]*' | awk '{print $2}')
    
    echo "æ–‡ä»¶: $file"
    echo "  æ£€æµ‹ç¼–ç : $detected (ç½®ä¿¡åº¦: $confidence)"
    
    # å¦‚æœç½®ä¿¡åº¦å¤ªä½ï¼Œè·³è¿‡
    if (( $(echo "$confidence < 0.7" | bc -l) )); then
        echo "  âš ï¸  ç½®ä¿¡åº¦è¿‡ä½ï¼Œè·³è¿‡è½¬æ¢"
        return
    fi
    
    # å¦‚æœå·²ç»æ˜¯UTF-8ï¼Œè·³è¿‡
    if [[ "$detected" == "UTF-8" ]] || [[ "$detected" == "ascii" ]]; then
        echo "  âœ… å·²ç»æ˜¯ $TARGET_ENCODING ç¼–ç "
        return
    fi
    
    # æ‰§è¡Œè½¬æ¢
    echo "  ğŸ”„ è½¬æ¢: $detected â†’ $TARGET_ENCODING"
    cp "$file" "$file.bak"
    
    if iconv -f "$detected" -t "$TARGET_ENCODING" "$file.bak" > "$file" 2>/dev/null; then
        echo "  âœ… è½¬æ¢æˆåŠŸ"
        rm "$file.bak"
    else
        echo "  âŒ è½¬æ¢å¤±è´¥ï¼Œæ¢å¤åŸæ–‡ä»¶"
        mv "$file.bak" "$file"
    fi
}

# å¤„ç†æ–‡ä»¶æˆ–ç›®å½•
if [ -f "$1" ]; then
    convert_file "$1"
elif [ -d "$1" ]; then
    find "$1" -type f -name "*.txt" -o -name "*.md" -o -name "*.csv" | while read -r file; do
        convert_file "$file"
    done
else
    echo "ç”¨æ³•: $0 <æ–‡ä»¶æˆ–ç›®å½•>"
    exit 1
fi
```

### 5.3 ä¼ä¸šçº§æ‰¹é‡è½¬æ¢æ–¹æ¡ˆ


**ğŸ”¸ å¤§è§„æ¨¡æ–‡ä»¶å¤„ç†**
```bash
#!/bin/bash
# enterprise_convert.sh - ä¼ä¸šçº§æ‰¹é‡ç¼–ç è½¬æ¢

# é…ç½®åŒºåŸŸ
LOG_FILE="conversion_$(date +%Y%m%d_%H%M%S).log"
BACKUP_DIR="./encoding_backup_$(date +%Y%m%d)"
SUPPORTED_EXTENSIONS=("txt" "md" "csv" "html" "xml" "sql")

# åˆ›å»ºæ—¥å¿—å‡½æ•°
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "$BACKUP_DIR"

# ç»Ÿè®¡ä¿¡æ¯
declare -A stats
stats[total]=0
stats[converted]=0
stats[skipped]=0
stats[failed]=0

process_file() {
    local file="$1"
    local relative_path="${file#./}"
    
    stats[total]=$((stats[total] + 1))
    
    # åˆ›å»ºç›¸åº”çš„å¤‡ä»½ç›®å½•ç»“æ„
    local backup_file="$BACKUP_DIR/$relative_path"
    local backup_dir=$(dirname "$backup_file")
    mkdir -p "$backup_dir"
    
    # å¤‡ä»½åŸæ–‡ä»¶
    cp "$file" "$backup_file"
    log_message "å¤‡ä»½æ–‡ä»¶: $file â†’ $backup_file"
    
    # æ£€æµ‹ç¼–ç 
    local detection=$(chardet "$file")
    local encoding=$(echo "$detection" | awk -F': ' '{print $2}' | awk '{print $1}')
    local confidence=$(echo "$detection" | grep -o '[0-9.]*$')
    
    # ç½®ä¿¡åº¦æ£€æŸ¥
    if (( $(echo "$confidence < 0.8" | bc -l) )); then
        log_message "âš ï¸  æ–‡ä»¶ $file ç¼–ç æ£€æµ‹ç½®ä¿¡åº¦è¿‡ä½ ($confidence)ï¼Œè·³è¿‡"
        stats[skipped]=$((stats[skipped] + 1))
        return
    fi
    
    # UTF-8æ£€æŸ¥
    if [[ "$encoding" == "UTF-8" ]] || [[ "$encoding" == "ascii" ]]; then
        log_message "âœ… æ–‡ä»¶ $file å·²ç»æ˜¯UTF-8ç¼–ç "
        stats[skipped]=$((stats[skipped] + 1))
        return
    fi
    
    # æ‰§è¡Œè½¬æ¢
    log_message "ğŸ”„ è½¬æ¢æ–‡ä»¶: $file ($encoding â†’ UTF-8)"
    
    if iconv -f "$encoding" -t "UTF-8//IGNORE" "$backup_file" > "$file" 2>/dev/null; then
        log_message "âœ… è½¬æ¢æˆåŠŸ: $file"
        stats[converted]=$((stats[converted] + 1))
        
        # éªŒè¯è½¬æ¢ç»“æœ
        if ! file -i "$file" | grep -q "charset=utf-8"; then
            log_message "âŒ è½¬æ¢éªŒè¯å¤±è´¥: $fileï¼Œæ¢å¤å¤‡ä»½"
            cp "$backup_file" "$file"
            stats[failed]=$((stats[failed] + 1))
            stats[converted]=$((stats[converted] - 1))
        fi
    else
        log_message "âŒ è½¬æ¢å¤±è´¥: $fileï¼Œæ¢å¤å¤‡ä»½"
        cp "$backup_file" "$file"
        stats[failed]=$((stats[failed] + 1))
    fi
}

# ä¸»å¤„ç†é€»è¾‘
main() {
    local target_dir="${1:-.}"
    
    log_message "å¼€å§‹ä¼ä¸šçº§æ‰¹é‡ç¼–ç è½¬æ¢"
    log_message "ç›®æ ‡ç›®å½•: $target_dir"
    log_message "å¤‡ä»½ç›®å½•: $BACKUP_DIR"
    
    # æ„å»ºfindå‘½ä»¤çš„æ‰©å±•ååŒ¹é…
    local find_extensions=""
    for ext in "${SUPPORTED_EXTENSIONS[@]}"; do
        if [ -n "$find_extensions" ]; then
            find_extensions="$find_extensions -o"
        fi
        find_extensions="$find_extensions -name *.${ext}"
    done
    
    # æŸ¥æ‰¾å¹¶å¤„ç†æ–‡ä»¶
    eval "find '$target_dir' -type f \( $find_extensions \)" | while read -r file; do
        process_file "$file"
    done
    
    # è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
    log_message "================== è½¬æ¢å®Œæˆ =================="
    log_message "æ€»æ–‡ä»¶æ•°: ${stats[total]}"
    log_message "æˆåŠŸè½¬æ¢: ${stats[converted]}"
    log_message "è·³è¿‡æ–‡ä»¶: ${stats[skipped]}"
    log_message "å¤±è´¥æ–‡ä»¶: ${stats[failed]}"
    log_message "å¤‡ä»½ä½ç½®: $BACKUP_DIR"
    log_message "è¯¦ç»†æ—¥å¿—: $LOG_FILE"
}

# è„šæœ¬å…¥å£
if [ "$#" -eq 0 ]; then
    echo "ç”¨æ³•: $0 [ç›®å½•è·¯å¾„]"
    echo "å¦‚æœä¸æŒ‡å®šç›®å½•ï¼Œå°†å¤„ç†å½“å‰ç›®å½•"
fi

main "$1"
```

---

## 6. ğŸ”§ ç¼–ç é—®é¢˜è¯Šæ–­ä¸ä¿®å¤


### 6.1 BOMæ ‡è¯†çš„å¤„ç†


**ğŸ”¸ ä»€ä¹ˆæ˜¯BOM**
```
BOM = Byte Order Markï¼ˆå­—èŠ‚é¡ºåºæ ‡è®°ï¼‰
å°±åƒæ–‡ä»¶çš„"èº«ä»½è¯"ï¼Œå‘Šè¯‰ç¨‹åºè¿™ä¸ªæ–‡ä»¶ç”¨ä»€ä¹ˆç¼–ç 

UTF-8 BOM: EF BB BFï¼ˆ3ä¸ªå­—èŠ‚ï¼‰
é—®é¢˜ï¼šæœ‰äº›ç¨‹åºä¸è¯†åˆ«BOMï¼Œä¼šæ˜¾ç¤ºå¥‡æ€ªå­—ç¬¦
```

**ğŸ“‹ BOMæ£€æµ‹å’Œå¤„ç†**
```bash
# æ£€æµ‹æ–‡ä»¶æ˜¯å¦æœ‰BOM
hexdump -C file.txt | head -1

# å¦‚æœå¼€å¤´æ˜¾ç¤º "ef bb bf"ï¼Œè¯´æ˜æœ‰UTF-8 BOM

# ç§»é™¤UTF-8 BOM
sed -i '1s/^\xEF\xBB\xBF//' file.txt

# æˆ–è€…ç”¨ä¸“é—¨çš„å·¥å…·
# å®‰è£…dos2unixå·¥å…·åŒ…
sudo apt install dos2unix

# ç§»é™¤BOM
dos2unix -r file.txt
```

**ğŸ”§ æ‰¹é‡BOMå¤„ç†è„šæœ¬**
```bash
#!/bin/bash
# remove_bom.sh - æ‰¹é‡ç§»é™¤UTF-8 BOM

remove_bom() {
    local file="$1"
    
    # æ£€æŸ¥æ˜¯å¦æœ‰BOM
    if [ "$(hexdump -C "$file" | head -1 | grep 'ef bb bf')" ]; then
        echo "å‘ç°BOM: $file"
        
        # åˆ›å»ºå¤‡ä»½
        cp "$file" "$file.bom_backup"
        
        # ç§»é™¤BOM
        sed -i '1s/^\xEF\xBB\xBF//' "$file"
        
        echo "âœ… å·²ç§»é™¤BOM: $file"
    else
        echo "æ— BOM: $file"
    fi
}

# å¤„ç†æ‰€æœ‰æ–‡æœ¬æ–‡ä»¶
find . -name "*.txt" -o -name "*.md" -o -name "*.html" | while read -r file; do
    remove_bom "$file"
done
```

### 6.2 ç¼–ç é”™è¯¯ä¿®å¤æ–¹æ³•


**ğŸ”¸ å¸¸è§ç¼–ç é”™è¯¯ç±»å‹**
```bash
# é”™è¯¯1ï¼šæ˜¾ç¤ºé—®å·æˆ–æ–¹å—
åŸå› ï¼šå­—ç¬¦æ— æ³•åœ¨å½“å‰ç¼–ç ä¸­è¡¨ç¤º
è§£å†³ï¼šè½¬æ¢åˆ°æ”¯æŒè¯¥å­—ç¬¦çš„ç¼–ç ï¼ˆé€šå¸¸æ˜¯UTF-8ï¼‰

# é”™è¯¯2ï¼šæ˜¾ç¤ºä¹±ç 
åŸå› ï¼šç”¨é”™è¯¯çš„ç¼–ç è§£è¯»æ–‡ä»¶
è§£å†³ï¼šé‡æ–°ç”¨æ­£ç¡®ç¼–ç è§£è¯»

# é”™è¯¯3ï¼šéƒ¨åˆ†å­—ç¬¦ä¸¢å¤±
åŸå› ï¼šè½¬æ¢è¿‡ç¨‹ä¸­æœ‰å­—ç¬¦æ— æ³•æ˜ å°„
è§£å†³ï¼šä½¿ç”¨å®½æ¾çš„è½¬æ¢é€‰é¡¹
```

**ğŸ“ ä¿®å¤å®ä¾‹**
```bash
# ä¿®å¤æ˜¾ç¤ºä¹±ç çš„æ–‡ä»¶
# æ­¥éª¤1ï¼šç¡®å®šåŸå§‹ç¼–ç 
chardet problem_file.txt
# å‡è®¾æ£€æµ‹ç»“æœæ˜¯ GBK

# æ­¥éª¤2ï¼šè½¬æ¢ç¼–ç 
iconv -f GBK -t UTF-8 problem_file.txt > fixed_file.txt

# æ­¥éª¤3ï¼šéªŒè¯ä¿®å¤ç»“æœ  
cat fixed_file.txt  # æŸ¥çœ‹æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

# å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå°è¯•å®½æ¾è½¬æ¢
iconv -f GBK -t UTF-8//IGNORE problem_file.txt > fixed_file.txt
```

**ğŸ”§ è‡ªåŠ¨ä¿®å¤è„šæœ¬**
```bash
#!/bin/bash
# fix_encoding.sh - è‡ªåŠ¨ç¼–ç ä¿®å¤å·¥å…·

fix_file() {
    local file="$1"
    echo "ä¿®å¤æ–‡ä»¶: $file"
    
    # å°è¯•å¤šç§å¯èƒ½çš„æºç¼–ç 
    local encodings=("GBK" "GB2312" "BIG5" "ISO-8859-1" "SHIFT_JIS")
    
    # åˆ›å»ºä¸´æ—¶æ–‡ä»¶
    local temp_file=$(mktemp)
    
    for encoding in "${encodings[@]}"; do
        echo "  å°è¯•ç¼–ç : $encoding"
        
        if iconv -f "$encoding" -t "UTF-8//IGNORE" "$file" > "$temp_file" 2>/dev/null; then
            # æ£€æŸ¥è½¬æ¢ç»“æœæ˜¯å¦åˆç†
            if [ -s "$temp_file" ] && file -i "$temp_file" | grep -q "utf-8"; then
                echo "  âœ… ä½¿ç”¨ $encoding ç¼–ç ä¿®å¤æˆåŠŸ"
                
                # å¤‡ä»½åŸæ–‡ä»¶
                cp "$file" "$file.encoding_backup"
                
                # åº”ç”¨ä¿®å¤
                cp "$temp_file" "$file"
                
                rm "$temp_file"
                return 0
            fi
        fi
    done
    
    echo "  âŒ æ— æ³•è‡ªåŠ¨ä¿®å¤æ­¤æ–‡ä»¶"
    rm "$temp_file"
    return 1
}

# å¤„ç†å‘½ä»¤è¡Œå‚æ•°
if [ $# -eq 0 ]; then
    echo "ç”¨æ³•: $0 <æ–‡ä»¶1> [æ–‡ä»¶2] [...]"
    exit 1
fi

for file in "$@"; do
    if [ -f "$file" ]; then
        fix_file "$file"
    else
        echo "æ–‡ä»¶ä¸å­˜åœ¨: $file"
    fi
done
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> **ğŸ¯ ä¸€å¥è¯æ€»ç»“**
> æ–‡ä»¶ç¼–ç å°±æ˜¯æ–‡å­—å’Œæ•°å­—ä¹‹é—´çš„ç¿»è¯‘è§„åˆ™ï¼Œç”¨é”™è§„åˆ™å°±ä¼šçœ‹åˆ°ä¹±ç 

**ğŸ”¸ æ ¸å¿ƒçŸ¥è¯†ç‚¹**
```
ç¼–ç æ£€æµ‹ï¼šchardetæ˜¯æœ€å¥½ç”¨çš„è‡ªåŠ¨æ£€æµ‹å·¥å…·
ç¼–ç è½¬æ¢ï¼šiconvæ˜¯æ ‡å‡†çš„è½¬æ¢å·¥å…·ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰ç¼–ç 
å¤šå­—èŠ‚å­—ç¬¦ï¼šä¸­æ–‡ç­‰å­—ç¬¦éœ€è¦å¤šä¸ªå­—èŠ‚å­˜å‚¨ï¼Œå¤„ç†æ—¶è¦å°å¿ƒ
BOMå¤„ç†ï¼šUTF-8çš„BOMæ ‡è¯†æœ‰æ—¶ä¼šå¼•èµ·é—®é¢˜ï¼Œéœ€è¦ç§»é™¤
æ‰¹é‡å¤„ç†ï¼šå†™è„šæœ¬è‡ªåŠ¨åŒ–å¤„ç†å¤§é‡æ–‡ä»¶
```

### 7.2 å®ç”¨å‘½ä»¤é€ŸæŸ¥


**âš¡ å¿«é€Ÿå‚è€ƒ**
```bash
# æ£€æµ‹ç¼–ç 
chardet filename.txt
file -i filename.txt

# è½¬æ¢ç¼–ç   
iconv -f GBK -t UTF-8 input.txt > output.txt

# æ‰¹é‡è½¬æ¢
for f in *.txt; do iconv -f GBK -t UTF-8 "$f" > "${f%.txt}_utf8.txt"; done

# æ£€æµ‹BOM
hexdump -C file.txt | head -1

# ç§»é™¤BOM
sed -i '1s/^\xEF\xBB\xBF//' file.txt
```

### 7.3 å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³


**â“ å¸¸è§ç–‘é—®**

**Qï¼šæ–‡ä»¶æ˜¾ç¤ºä¹±ç æ€ä¹ˆåŠï¼Ÿ**
**Aï¼š** å…ˆç”¨`chardet`æ£€æµ‹çœŸå®ç¼–ç ï¼Œå†ç”¨`iconv`è½¬æ¢ä¸ºUTF-8

**Qï¼šè½¬æ¢åè¿˜æ˜¯ä¹±ç æ€ä¹ˆåŠï¼Ÿ**  
**Aï¼š** å¯èƒ½æ£€æµ‹é”™è¯¯ï¼Œå°è¯•å…¶ä»–å¸¸è§ç¼–ç ï¼ˆGBKã€GB2312ã€Big5ï¼‰

**Qï¼šæ‰¹é‡è½¬æ¢æ—¶éƒ¨åˆ†æ–‡ä»¶å¤±è´¥ï¼Ÿ**
**Aï¼š** ä½¿ç”¨`//IGNORE`é€‰é¡¹å¿½ç•¥æ— æ³•è½¬æ¢çš„å­—ç¬¦ï¼Œæˆ–æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå

**Qï¼šLinuxä¸‹å¤„ç†Windowsæ–‡ä»¶ä¹±ç ï¼Ÿ**
**Aï¼š** Windowsä¸­æ–‡æ–‡ä»¶é€šå¸¸æ˜¯GBKç¼–ç ï¼Œè½¬æ¢ä¸ºUTF-8å³å¯

### 7.4 æœ€ä½³å®è·µå»ºè®®


**ğŸŒŸ æ¨èåšæ³•**
- â­ **ç»Ÿä¸€ä½¿ç”¨UTF-8ç¼–ç **ï¼šç°ä»£ç³»ç»Ÿçš„æ ‡å‡†é€‰æ‹©
- â­ **è½¬æ¢å‰å…ˆå¤‡ä»½**ï¼šé¿å…æ•°æ®ä¸¢å¤±
- â­ **ä½¿ç”¨è‡ªåŠ¨æ£€æµ‹**ï¼šchardetæ¯”æ‰‹å·¥çŒœæµ‹å‡†ç¡®
- â­ **éªŒè¯è½¬æ¢ç»“æœ**ï¼šè½¬æ¢åæ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
- â­ **ç¼–å†™é€šç”¨è„šæœ¬**ï¼šå¤„ç†é‡å¤æ€§å·¥ä½œ

**ğŸ”‘ å…³é”®è®°å¿†ç‚¹**
- `chardet` + `iconv` = ç¼–ç é—®é¢˜è§£å†³ç»„åˆæ‹³
- UTF-8 æ˜¯ç°ä»£ç³»ç»Ÿçš„é€šç”¨ç¼–ç æ ‡å‡†
- ä¸­æ–‡ä¹±ç 90%æ˜¯GBK/UTF-8æ··ç”¨é€ æˆçš„
- æ‰¹é‡å¤„ç†æ—¶ä¸€å®šè¦å¤‡ä»½åŸæ–‡ä»¶

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç¼–ç é—®é¢˜ä¸ç”¨æ…Œï¼Œchardetæ£€æµ‹iconvè½¬
UTF-8æ ‡å‡†è¦è®°ç‰¢ï¼Œå¤‡ä»½æ–‡ä»¶æœ€é‡è¦
ä¹±ç å¤šæ˜¯ç¼–ç æ··ï¼ŒGBKè½¬UTFè§£çƒ¦å¿§
```