---
title: 8ã€ç³»ç»Ÿç›‘æ§ä¸å®‰å…¨å®¡è®¡
---
## ğŸ“š ç›®å½•

1. [inotifyåŸºç¡€æ¦‚å¿µ](#1-inotifyåŸºç¡€æ¦‚å¿µ)
2. [inotifyå·¥ä½œåŸç†](#2-inotifyå·¥ä½œåŸç†)
3. [ç³»ç»Ÿå…³é”®æ–‡ä»¶ç›‘æ§ç­–ç•¥](#3-ç³»ç»Ÿå…³é”®æ–‡ä»¶ç›‘æ§ç­–ç•¥)
4. [é…ç½®æ–‡ä»¶ç¯¡æ”¹æ£€æµ‹](#4-é…ç½®æ–‡ä»¶ç¯¡æ”¹æ£€æµ‹)
5. [æ•æ„Ÿç›®å½•è®¿é—®ç›‘æ§](#5-æ•æ„Ÿç›®å½•è®¿é—®ç›‘æ§)
6. [ç”¨æˆ·è¡Œä¸ºå®¡è®¡è®°å½•](#6-ç”¨æˆ·è¡Œä¸ºå®¡è®¡è®°å½•)
7. [æ¶æ„æ–‡ä»¶æ´»åŠ¨æ£€æµ‹](#7-æ¶æ„æ–‡ä»¶æ´»åŠ¨æ£€æµ‹)
8. [å…¥ä¾µè¡Œä¸ºå®æ—¶å‘Šè­¦](#8-å…¥ä¾µè¡Œä¸ºå®æ—¶å‘Šè­¦)
9. [åˆè§„æ€§ç›‘æ§è¦æ±‚](#9-åˆè§„æ€§ç›‘æ§è¦æ±‚)
10. [å®‰å…¨äº‹ä»¶å“åº”è§¦å‘](#10-å®‰å…¨äº‹ä»¶å“åº”è§¦å‘)
11. [å®¡è®¡æ—¥å¿—è§„èŒƒåŒ–å­˜å‚¨](#11-å®¡è®¡æ—¥å¿—è§„èŒƒåŒ–å­˜å‚¨)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” inotifyåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯inotify


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
inotify = inode notifyï¼ˆç´¢å¼•èŠ‚ç‚¹é€šçŸ¥ï¼‰
ä½œç”¨ï¼šLinuxå†…æ ¸æä¾›çš„æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ç›‘æ§æœºåˆ¶
æœ¬è´¨ï¼šå®æ—¶ç›‘æ§æ–‡ä»¶å’Œç›®å½•çš„å˜åŒ–ï¼Œå½“å‘ç”Ÿå˜åŒ–æ—¶ç«‹å³é€šçŸ¥åº”ç”¨ç¨‹åº
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ æ˜¯ä¸€ä¸ªä¿å®‰ï¼Œinotifyå°±åƒç»™é‡è¦æˆ¿é—´å®‰è£…äº†æŠ¥è­¦å™¨ï¼Œä¸€æ—¦æœ‰äººè¿›å‡ºæˆ–æç ´åï¼Œç«‹åˆ»å°±ä¼šå“é“ƒé€šçŸ¥ä½ ã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦inotify


**ä¼ ç»Ÿç›‘æ§æ–¹å¼çš„é—®é¢˜**ï¼š
```
è½®è¯¢æ£€æŸ¥æ–¹å¼ï¼š
å®šæ—¶æ£€æŸ¥æ–‡ä»¶ â†’ å‘ç°å˜åŒ– â†’ å¤„ç†å˜åŒ–

é—®é¢˜ï¼š
âŒ èµ„æºæµªè´¹ï¼šä¸åœåœ°æ£€æŸ¥ï¼Œå³ä½¿æ²¡æœ‰å˜åŒ–
âŒ å»¶è¿Ÿé«˜ï¼šå¯èƒ½å‡ åˆ†é’Ÿæ‰å‘ç°å˜åŒ–
âŒ ä¸ç²¾ç¡®ï¼šåªçŸ¥é“å˜äº†ï¼Œä¸çŸ¥é“æ€ä¹ˆå˜çš„
```

**inotifyçš„ä¼˜åŠ¿**ï¼š
```
äº‹ä»¶é©±åŠ¨æ–¹å¼ï¼š
æ–‡ä»¶å˜åŒ– â†’ å†…æ ¸ç«‹å³é€šçŸ¥ â†’ åº”ç”¨ç¨‹åºå¤„ç†

ä¼˜åŠ¿ï¼š
âœ… å®æ—¶æ€§ï¼šå˜åŒ–ç«‹å³é€šçŸ¥ï¼Œå‡ ä¹é›¶å»¶è¿Ÿ
âœ… æ•ˆç‡é«˜ï¼šåªåœ¨å˜åŒ–æ—¶æ‰é€šçŸ¥ï¼Œä¸æµªè´¹èµ„æº
âœ… ä¿¡æ¯è¯¦ç»†ï¼šçŸ¥é“å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆç±»å‹çš„å˜åŒ–
```

### 1.3 inotifyçš„åº”ç”¨åœºæ™¯


**ğŸ“‹ å¸¸è§åº”ç”¨åœºæ™¯**ï¼š
- **é…ç½®æ–‡ä»¶ç›‘æ§**ï¼šç³»ç»Ÿé…ç½®è¢«ä¿®æ”¹æ—¶ç«‹å³ç”Ÿæ•ˆ
- **æ—¥å¿—æ–‡ä»¶ç›‘æ§**ï¼šæ–°æ—¥å¿—äº§ç”Ÿæ—¶ç«‹å³å¤„ç†
- **ä»£ç åŒæ­¥**ï¼šå¼€å‘æ—¶æ–‡ä»¶ä¿®æ”¹ç«‹å³åŒæ­¥
- **å®‰å…¨ç›‘æ§**ï¼šæ•æ„Ÿæ–‡ä»¶è¢«è®¿é—®æ—¶ç«‹å³å‘Šè­¦
- **å¤‡ä»½è§¦å‘**ï¼šé‡è¦æ–‡ä»¶ä¿®æ”¹åè‡ªåŠ¨å¤‡ä»½

---

## 2. âš™ï¸ inotifyå·¥ä½œåŸç†


### 2.1 å†…æ ¸æœºåˆ¶åŸç†


**ğŸ”§ å·¥ä½œæµç¨‹å›¾**ï¼š
```
åº”ç”¨ç¨‹åº                  å†…æ ¸ç©ºé—´                æ–‡ä»¶ç³»ç»Ÿ
    |                       |                       |
    |--åˆ›å»ºinotifyå®ä¾‹------>|                       |
    |<--è¿”å›æ–‡ä»¶æè¿°ç¬¦-------|                       |
    |                       |                       |
    |--æ·»åŠ ç›‘æ§è·¯å¾„--------->|--æ³¨å†Œç›‘æ§------------>|
    |<--è¿”å›ç›‘æ§æè¿°ç¬¦-------|                       |
    |                       |                       |
    |                       |<--æ–‡ä»¶å˜åŒ–äº‹ä»¶--------|
    |<--é€šçŸ¥äº‹ä»¶-------------|                       |
    |                       |                       |
    |--è¯»å–äº‹ä»¶è¯¦æƒ…--------->|                       |
    |<--äº‹ä»¶è¯¦ç»†ä¿¡æ¯---------|                       |
```

### 2.2 æ ¸å¿ƒç»„ä»¶


**ğŸ”¸ ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
1. inotifyå®ä¾‹ï¼ˆinotify instanceï¼‰
   - å°±åƒä¸€ä¸ª"ç›‘æ§ä¸­å¿ƒ"
   - æ¯ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åˆ›å»ºå¤šä¸ªç›‘æ§ä¸­å¿ƒ
   - ç”¨æ–‡ä»¶æè¿°ç¬¦æ ‡è¯†

2. ç›‘æ§æè¿°ç¬¦ï¼ˆwatch descriptorï¼‰
   - å°±åƒç»™æ¯ä¸ªè¢«ç›‘æ§å¯¹è±¡çš„"èº«ä»½è¯å·"
   - æ¯æ·»åŠ ä¸€ä¸ªç›‘æ§è·¯å¾„å°±å¾—åˆ°ä¸€ä¸ªç¼–å·
   - ç”¨æ¥åŒºåˆ†æ˜¯å“ªä¸ªè·¯å¾„å‘ç”Ÿäº†å˜åŒ–

3. äº‹ä»¶ï¼ˆeventï¼‰
   - å°±åƒ"æŠ¥è­¦ä¿¡æ¯"
   - å‘Šè¯‰ä½ å‘ç”Ÿäº†ä»€ä¹ˆäº‹ã€åœ¨å“ªé‡Œå‘ç”Ÿçš„
   - åŒ…å«äº‹ä»¶ç±»å‹ã€è·¯å¾„ã€æ–‡ä»¶åç­‰ä¿¡æ¯
```

### 2.3 äº‹ä»¶ç±»å‹è¯¦è§£


**ğŸ“Š å¸¸ç”¨äº‹ä»¶ç±»å‹**ï¼š

| äº‹ä»¶ç±»å‹ | **å«ä¹‰è¯´æ˜** | **è§¦å‘åœºæ™¯** |
|---------|-------------|-------------|
| `IN_ACCESS` | æ–‡ä»¶è¢«è¯»å– | æ‰“å¼€æ–‡ä»¶æŸ¥çœ‹å†…å®¹ |
| `IN_MODIFY` | æ–‡ä»¶å†…å®¹è¢«ä¿®æ”¹ | ç¼–è¾‘æ–‡ä»¶å¹¶ä¿å­˜ |
| `IN_ATTRIB` | æ–‡ä»¶å±æ€§å˜åŒ– | æ”¹å˜æƒé™ã€æ‰€æœ‰è€… |
| `IN_CLOSE_WRITE` | å¯å†™æ–‡ä»¶å…³é—­ | ç¼–è¾‘å®Œæ–‡ä»¶åå…³é—­ |
| `IN_CLOSE_NOWRITE` | åªè¯»æ–‡ä»¶å…³é—­ | æŸ¥çœ‹å®Œæ–‡ä»¶åå…³é—­ |
| `IN_OPEN` | æ–‡ä»¶è¢«æ‰“å¼€ | ä»»ä½•æ‰“å¼€æ–‡ä»¶çš„æ“ä½œ |
| `IN_MOVED_FROM` | æ–‡ä»¶è¢«ç§»å‡º | ç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶ |
| `IN_MOVED_TO` | æ–‡ä»¶è¢«ç§»å…¥ | æ–‡ä»¶ç§»åŠ¨åˆ°ç›‘æ§ç›®å½• |
| `IN_CREATE` | æ–‡ä»¶/ç›®å½•åˆ›å»º | æ–°å»ºæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ |
| `IN_DELETE` | æ–‡ä»¶/ç›®å½•åˆ é™¤ | åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ |

---

## 3. ğŸ›¡ï¸ ç³»ç»Ÿå…³é”®æ–‡ä»¶ç›‘æ§ç­–ç•¥


### 3.1 å…³é”®æ–‡ä»¶è¯†åˆ«


**ğŸ”¸ ç³»ç»Ÿæ ¸å¿ƒæ–‡ä»¶æ¸…å•**ï¼š
```
å¯†ç æ–‡ä»¶ï¼š
/etc/passwd          â† ç”¨æˆ·è´¦å·ä¿¡æ¯
/etc/shadow          â† ç”¨æˆ·å¯†ç å“ˆå¸Œ
/etc/group           â† ç”¨æˆ·ç»„ä¿¡æ¯

ç³»ç»Ÿé…ç½®ï¼š
/etc/ssh/sshd_config â† SSHæœåŠ¡é…ç½®
/etc/sudoers         â† sudoæƒé™é…ç½®
/etc/hosts           â† ä¸»æœºåè§£æ
/etc/fstab          â† æ–‡ä»¶ç³»ç»ŸæŒ‚è½½

å¯åŠ¨æ–‡ä»¶ï¼š
/etc/crontab        â† è®¡åˆ’ä»»åŠ¡
/etc/rc.local       â† å¯åŠ¨è„šæœ¬
/etc/systemd/system/ â† ç³»ç»ŸæœåŠ¡
```

### 3.2 ç›‘æ§ç­–ç•¥è®¾è®¡


**ğŸ¯ åˆ†çº§ç›‘æ§ç­–ç•¥**ï¼š

**é«˜å±çº§åˆ«ï¼ˆå®æ—¶å‘Šè­¦ï¼‰**ï¼š
```bash
# ç›‘æ§å¯†ç æ–‡ä»¶
inotifywait -m -e modify,attrib /etc/passwd /etc/shadow /etc/group
```

**ä¸­ç­‰çº§åˆ«ï¼ˆè®°å½•æ—¥å¿—ï¼‰**ï¼š
```bash
# ç›‘æ§é…ç½®ç›®å½•
inotifywait -m -r -e modify,create,delete /etc/ssh/ /etc/systemd/
```

**ä½çº§åˆ«ï¼ˆå®šæœŸæ±‡æ€»ï¼‰**ï¼š
```bash
# ç›‘æ§æ—¥å¿—ç›®å½•
inotifywait -m -r -e create,modify /var/log/
```

### 3.3 å®é™…ç›‘æ§è„šæœ¬


**ğŸ”§ ç³»ç»Ÿå…³é”®æ–‡ä»¶ç›‘æ§è„šæœ¬**ï¼š
```bash
#!/bin/bash
# ç³»ç»Ÿå…³é”®æ–‡ä»¶ç›‘æ§è„šæœ¬

# å®šä¹‰ç›‘æ§æ–‡ä»¶åˆ—è¡¨
CRITICAL_FILES=(
    "/etc/passwd"
    "/etc/shadow" 
    "/etc/group"
    "/etc/sudoers"
    "/etc/ssh/sshd_config"
)

# å¯åŠ¨ç›‘æ§
echo "å¼€å§‹ç›‘æ§ç³»ç»Ÿå…³é”®æ–‡ä»¶..."
inotifywait -m -e modify,attrib,delete "${CRITICAL_FILES[@]}" --format '%T %w %f %e' --timefmt '%Y-%m-%d %H:%M:%S' |
while read TIME FILE NAME EVENT; do
    # è®°å½•åˆ°æ—¥å¿—
    echo "[$TIME] ğŸš¨ å…³é”®æ–‡ä»¶å˜åŒ–: $FILE$NAME äº‹ä»¶: $EVENT" >> /var/log/critical-files.log
    
    # å‘é€å‘Šè­¦
    echo "è­¦å‘Š: å…³é”®æ–‡ä»¶ $FILE$NAME å‘ç”Ÿå˜åŒ– ($EVENT)" | 
    mail -s "ç³»ç»Ÿå®‰å…¨å‘Šè­¦" admin@company.com
done
```

---

## 4. ğŸ”§ é…ç½®æ–‡ä»¶ç¯¡æ”¹æ£€æµ‹


### 4.1 é…ç½®æ–‡ä»¶ç¯¡æ”¹æ£€æµ‹åŸç†


**ğŸ”¸ æ£€æµ‹æœºåˆ¶**ï¼š
```
é…ç½®æ–‡ä»¶ç¯¡æ”¹æ£€æµ‹æµç¨‹ï¼š

1. åŸºçº¿å»ºç«‹
   â”œâ”€â”€ è®¡ç®—é…ç½®æ–‡ä»¶å“ˆå¸Œå€¼
   â”œâ”€â”€ è®°å½•æ–‡ä»¶æƒé™å’Œå±æ€§
   â””â”€â”€ ä¿å­˜åŸºçº¿ä¿¡æ¯

2. å®æ—¶ç›‘æ§  
   â”œâ”€â”€ inotifyç›‘æ§æ–‡ä»¶å˜åŒ–
   â”œâ”€â”€ æ•è·ä¿®æ”¹äº‹ä»¶
   â””â”€â”€ è§¦å‘æ£€æµ‹ç¨‹åº

3. å˜åŒ–æ£€æµ‹
   â”œâ”€â”€ é‡æ–°è®¡ç®—å“ˆå¸Œå€¼
   â”œâ”€â”€ å¯¹æ¯”åŸºçº¿ä¿¡æ¯
   â””â”€â”€ åˆ¤æ–­æ˜¯å¦ä¸ºæ¶æ„ç¯¡æ”¹

4. å“åº”å¤„ç†
   â”œâ”€â”€ è®°å½•è¯¦ç»†æ—¥å¿—
   â”œâ”€â”€ å‘é€å‘Šè­¦é€šçŸ¥  
   â””â”€â”€ å¯é€‰æ‹©è‡ªåŠ¨æ¢å¤
```

### 4.2 é…ç½®æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥


**ğŸ”§ å“ˆå¸Œå€¼å¯¹æ¯”æ£€æµ‹**ï¼š
```bash
#!/bin/bash
# é…ç½®æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥è„šæœ¬

CONFIG_DIR="/etc"
BASELINE_FILE="/var/lib/config-baseline.txt" 
LOG_FILE="/var/log/config-integrity.log"

# ç”Ÿæˆé…ç½®æ–‡ä»¶åŸºçº¿
generate_baseline() {
    echo "ç”Ÿæˆé…ç½®æ–‡ä»¶åŸºçº¿..."
    find $CONFIG_DIR -type f -name "*.conf" -o -name "*.cfg" | 
    while read file; do
        hash=$(md5sum "$file" | cut -d' ' -f1)
        perm=$(stat -c "%a" "$file")
        echo "$file:$hash:$perm" >> $BASELINE_FILE
    done
}

# æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§  
check_integrity() {
    local file=$1
    local current_hash=$(md5sum "$file" | cut -d' ' -f1)
    local baseline_info=$(grep "^$file:" $BASELINE_FILE)
    
    if [ -n "$baseline_info" ]; then
        local baseline_hash=$(echo $baseline_info | cut -d':' -f2)
        if [ "$current_hash" != "$baseline_hash" ]; then
            echo "[$(date)] ğŸš¨ é…ç½®æ–‡ä»¶è¢«ç¯¡æ”¹: $file" >> $LOG_FILE
            echo "åŸå§‹å“ˆå¸Œ: $baseline_hash" >> $LOG_FILE  
            echo "å½“å‰å“ˆå¸Œ: $current_hash" >> $LOG_FILE
            return 1
        fi
    fi
    return 0
}
```

### 4.3 è‡ªåŠ¨æ¢å¤æœºåˆ¶


**ğŸ”„ é…ç½®æ–‡ä»¶è‡ªåŠ¨æ¢å¤**ï¼š
```bash
# é…ç½®æ–‡ä»¶å¤‡ä»½å’Œæ¢å¤
backup_config() {
    local file=$1
    local backup_dir="/var/backups/configs"
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    mkdir -p "$backup_dir"
    
    # å¤‡ä»½æ–‡ä»¶ï¼ˆä¿ç•™ç›®å½•ç»“æ„ï¼‰
    local backup_path="$backup_dir$(dirname $file)"
    mkdir -p "$backup_path"
    cp "$file" "$backup_path/$(basename $file).backup.$(date +%Y%m%d_%H%M%S)"
}

# æ¢å¤é…ç½®æ–‡ä»¶
restore_config() {
    local file=$1
    local backup_dir="/var/backups/configs"
    local latest_backup=$(ls -t $backup_dir$(dirname $file)/*.backup.* 2>/dev/null | head -1)
    
    if [ -n "$latest_backup" ]; then
        echo "æ¢å¤é…ç½®æ–‡ä»¶: $file"
        cp "$latest_backup" "$file"
        echo "é…ç½®æ–‡ä»¶å·²æ¢å¤: $file" >> $LOG_FILE
    fi
}
```

---

## 5. ğŸ“ æ•æ„Ÿç›®å½•è®¿é—®ç›‘æ§


### 5.1 æ•æ„Ÿç›®å½•å®šä¹‰


**ğŸ”¸ æ•æ„Ÿç›®å½•åˆ†ç±»**ï¼š
```
ç³»ç»Ÿæ•æ„Ÿç›®å½•ï¼š
/root/              â† è¶…çº§ç”¨æˆ·ä¸»ç›®å½•
/etc/               â† ç³»ç»Ÿé…ç½®ç›®å½•  
/var/log/           â† ç³»ç»Ÿæ—¥å¿—ç›®å½•
/usr/local/bin/     â† æœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶
/opt/               â† ç¬¬ä¸‰æ–¹è½¯ä»¶ç›®å½•

ç”¨æˆ·æ•æ„Ÿç›®å½•ï¼š
/home/*/            â† ç”¨æˆ·ä¸»ç›®å½•
/tmp/               â† ä¸´æ—¶æ–‡ä»¶ç›®å½•
/var/tmp/           â† ä¸´æ—¶æ–‡ä»¶ç›®å½•
/var/www/           â† Webæ ¹ç›®å½•
/var/lib/mysql/     â† æ•°æ®åº“æ•°æ®ç›®å½•
```

### 5.2 ç›®å½•è®¿é—®æ¨¡å¼åˆ†æ


**ğŸ“Š è®¿é—®æ¨¡å¼ç±»å‹**ï¼š

| è®¿é—®æ¨¡å¼ | **é£é™©ç­‰çº§** | **å…¸å‹ç‰¹å¾** | **å¤„ç†ç­–ç•¥** |
|---------|-------------|-------------|-------------|
| **æ­£å¸¸è®¿é—®** | ğŸŸ¢ ä½ | å·¥ä½œæ—¶é—´ã€å·²çŸ¥ç”¨æˆ·ã€å¸¸è§„æ“ä½œ | è®°å½•æ—¥å¿— |
| **å¼‚å¸¸è®¿é—®** | ğŸŸ¡ ä¸­ | éå·¥ä½œæ—¶é—´ã€é¢‘ç¹è®¿é—®ã€å¤§é‡è¯»å– | é‡ç‚¹ç›‘æ§ |  
| **å¯ç–‘è®¿é—®** | ğŸŸ  é«˜ | æœªçŸ¥ç”¨æˆ·ã€å¼‚å¸¸è·¯å¾„ã€æ•æ„Ÿæ“ä½œ | å®æ—¶å‘Šè­¦ |
| **æ¶æ„è®¿é—®** | ğŸ”´ ä¸¥é‡ | æƒé™æå‡ã€æ‰¹é‡æ“ä½œã€åŠ å¯†è¡Œä¸º | ç«‹å³é˜»æ–­ |

### 5.3 ç›®å½•ç›‘æ§å®ç°


**ğŸ”§ æ•æ„Ÿç›®å½•ç›‘æ§è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æ•æ„Ÿç›®å½•è®¿é—®ç›‘æ§

SENSITIVE_DIRS=(
    "/root"
    "/etc" 
    "/var/log"
    "/home"
    "/tmp"
)

LOG_FILE="/var/log/sensitive-access.log"

# å¯åŠ¨ç›®å½•ç›‘æ§
monitor_directories() {
    echo "å¼€å§‹ç›‘æ§æ•æ„Ÿç›®å½•..."
    
    inotifywait -m -r -e access,open,create,delete,modify "${SENSITIVE_DIRS[@]}" \
    --format '%T %w%f %e %u' --timefmt '%Y-%m-%d %H:%M:%S' |
    while read TIME PATH EVENT USER; do
        # åˆ†æè®¿é—®æ¨¡å¼
        analyze_access "$TIME" "$PATH" "$EVENT" "$USER"
    done
}

# è®¿é—®æ¨¡å¼åˆ†æ
analyze_access() {
    local time=$1
    local path=$2  
    local event=$3
    local user=$4
    
    # è·å–å½“å‰å°æ—¶
    local hour=$(date +%H)
    
    # åˆ¤æ–­è®¿é—®é£é™©ç­‰çº§
    local risk_level="ä½"
    
    # éå·¥ä½œæ—¶é—´è®¿é—®
    if [ $hour -lt 8 ] || [ $hour -gt 18 ]; then
        risk_level="ä¸­"
    fi
    
    # æ•æ„Ÿæ“ä½œ
    if [[ "$event" =~ (DELETE|CREATE) ]] && [[ "$path" =~ (/etc/|/root/) ]]; then
        risk_level="é«˜"
    fi
    
    # è®°å½•æ—¥å¿—
    echo "[$time] é£é™©ç­‰çº§:$risk_level è·¯å¾„:$path äº‹ä»¶:$event ç”¨æˆ·:$user" >> $LOG_FILE
    
    # é«˜é£é™©å‘Šè­¦
    if [ "$risk_level" = "é«˜" ]; then
        send_alert "$time" "$path" "$event" "$user"
    fi
}
```

---

## 6. ğŸ‘¤ ç”¨æˆ·è¡Œä¸ºå®¡è®¡è®°å½•


### 6.1 ç”¨æˆ·è¡Œä¸ºå®¡è®¡æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç”¨æˆ·è¡Œä¸ºå®¡è®¡**ï¼š
```
ç”¨æˆ·è¡Œä¸ºå®¡è®¡ = è®°å½•å’Œåˆ†æç”¨æˆ·åœ¨ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ´»åŠ¨

ç›®çš„ï¼š
âœ… è¿½è¸ªç”¨æˆ·æ“ä½œè½¨è¿¹
âœ… å‘ç°å¼‚å¸¸è¡Œä¸ºæ¨¡å¼  
âœ… æä¾›å®‰å…¨äº‹ä»¶è¯æ®
âœ… æ»¡è¶³åˆè§„æ€§è¦æ±‚
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒç»™æ¯ä¸ªç”¨æˆ·é…ä¸€ä¸ª"è¡Œä¸ºè®°å½•ä»ª"ï¼Œè®°å½•ä»–ä»¬åœ¨ç³»ç»Ÿé‡Œåšäº†ä»€ä¹ˆï¼Œæ–¹ä¾¿åç»­æŸ¥è¯å’Œåˆ†æã€‚

### 6.2 ç”¨æˆ·è¡Œä¸ºåˆ†ç±»


**ğŸ“‹ ç”¨æˆ·è¡Œä¸ºç±»å‹**ï¼š
```
æ–‡ä»¶æ“ä½œè¡Œä¸ºï¼š
â”œâ”€â”€ æ–‡ä»¶è®¿é—®ï¼ˆæ‰“å¼€ã€è¯»å–ï¼‰
â”œâ”€â”€ æ–‡ä»¶ä¿®æ”¹ï¼ˆç¼–è¾‘ã€ä¿å­˜ï¼‰
â”œâ”€â”€ æ–‡ä»¶åˆ›å»ºï¼ˆæ–°å»ºæ–‡ä»¶/ç›®å½•ï¼‰  
â”œâ”€â”€ æ–‡ä»¶åˆ é™¤ï¼ˆåˆ é™¤æ–‡ä»¶/ç›®å½•ï¼‰
â””â”€â”€ æ–‡ä»¶ç§»åŠ¨ï¼ˆé‡å‘½åã€ç§»åŠ¨ï¼‰

ç³»ç»Ÿæ“ä½œè¡Œä¸ºï¼š
â”œâ”€â”€ ç™»å½•ç™»å‡ºï¼ˆSSHã€æœ¬åœ°ç™»å½•ï¼‰
â”œâ”€â”€ æƒé™å˜æ›´ï¼ˆsudoã€suï¼‰
â”œâ”€â”€ æœåŠ¡æ“ä½œï¼ˆå¯åŠ¨ã€åœæ­¢æœåŠ¡ï¼‰
â”œâ”€â”€ ç½‘ç»œè¿æ¥ï¼ˆå¤–éƒ¨è¿æ¥ã€ç«¯å£ç›‘å¬ï¼‰
â””â”€â”€ è¿›ç¨‹æ“ä½œï¼ˆå¯åŠ¨ã€æ€æ­»è¿›ç¨‹ï¼‰
```

### 6.3 ç”¨æˆ·è¡Œä¸ºç›‘æ§å®ç°


**ğŸ”§ ç”¨æˆ·æ–‡ä»¶æ“ä½œå®¡è®¡**ï¼š
```bash
#!/bin/bash
# ç”¨æˆ·æ–‡ä»¶æ“ä½œå®¡è®¡è„šæœ¬

AUDIT_DIR="/home"
AUDIT_LOG="/var/log/user-audit.log"

# è·å–ç”¨æˆ·ä¿¡æ¯
get_user_info() {
    local pid=$1
    local user=$(ps -o user= -p $pid 2>/dev/null)
    local cmd=$(ps -o comm= -p $pid 2>/dev/null)
    echo "$user:$cmd"
}

# å¼€å§‹ç”¨æˆ·è¡Œä¸ºç›‘æ§
start_user_audit() {
    echo "å¼€å§‹ç”¨æˆ·è¡Œä¸ºå®¡è®¡..."
    
    inotifywait -m -r -e access,modify,create,delete,move "$AUDIT_DIR" \
    --format '%T %w%f %e' --timefmt '%Y-%m-%d %H:%M:%S' |
    while read TIME PATH EVENT; do
        # è·å–è§¦å‘è¿›ç¨‹ä¿¡æ¯
        local pids=$(lsof +D "$(dirname "$PATH")" 2>/dev/null | awk 'NR>1 {print $2}' | sort -u)
        
        for pid in $pids; do
            local user_info=$(get_user_info $pid)
            local user=$(echo $user_info | cut -d: -f1)
            local command=$(echo $user_info | cut -d: -f2)
            
            if [ -n "$user" ] && [ "$user" != "root" ]; then
                # è®°å½•ç”¨æˆ·è¡Œä¸º
                echo "[$TIME] ç”¨æˆ·:$user å‘½ä»¤:$command æ“ä½œ:$EVENT æ–‡ä»¶:$PATH" >> $AUDIT_LOG
                
                # æ£€æŸ¥æ˜¯å¦ä¸ºæ•æ„Ÿæ“ä½œ
                check_sensitive_operation "$TIME" "$user" "$command" "$EVENT" "$PATH"
            fi
        done
    done
}

# æ£€æŸ¥æ•æ„Ÿæ“ä½œ
check_sensitive_operation() {
    local time=$1 user=$2 cmd=$3 event=$4 path=$5
    
    # æ•æ„Ÿæ“ä½œåˆ¤æ–­
    if [[ "$event" =~ (DELETE|CREATE) ]] && [[ "$path" =~ \.(sh|py|pl)$ ]]; then
        echo "ğŸš¨ æ•æ„Ÿæ“ä½œå‘Šè­¦: ç”¨æˆ· $user é€šè¿‡ $cmd å¯¹è„šæœ¬æ–‡ä»¶æ‰§è¡Œ $event æ“ä½œ: $path" | 
        tee -a $AUDIT_LOG
    fi
}
```

### 6.4 ç”¨æˆ·è¡Œä¸ºåˆ†æ


**ğŸ“Š è¡Œä¸ºæ¨¡å¼åˆ†æ**ï¼š
```bash
# ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡åˆ†æ
analyze_user_behavior() {
    local log_file=$1
    local date_range=${2:-"today"}
    
    echo "=== ç”¨æˆ·è¡Œä¸ºåˆ†ææŠ¥å‘Š ==="
    echo "æ—¶é—´èŒƒå›´: $date_range"
    echo
    
    # æœ€æ´»è·ƒç”¨æˆ·
    echo "ğŸ“Š æœ€æ´»è·ƒç”¨æˆ· TOP 5:"
    grep "$(date +%Y-%m-%d)" $log_file | 
    awk '{print $3}' | sort | uniq -c | sort -nr | head -5 |
    while read count user; do
        echo "  $user: $count æ¬¡æ“ä½œ"
    done
    echo
    
    # æœ€å¸¸ç”¨å‘½ä»¤
    echo "ğŸ”§ æœ€å¸¸ç”¨å‘½ä»¤ TOP 5:"  
    grep "$(date +%Y-%m-%d)" $log_file |
    awk '{print $4}' | sort | uniq -c | sort -nr | head -5 |
    while read count cmd; do
        echo "  $cmd: $count æ¬¡ä½¿ç”¨"
    done
    echo
    
    # æ•æ„Ÿæ“ä½œç»Ÿè®¡
    echo "âš ï¸ æ•æ„Ÿæ“ä½œç»Ÿè®¡:"
    local sensitive_count=$(grep -c "æ•æ„Ÿæ“ä½œå‘Šè­¦" $log_file)
    echo "  ä»Šæ—¥æ•æ„Ÿæ“ä½œ: $sensitive_count æ¬¡"
}
```

---

## 7. ğŸ¦  æ¶æ„æ–‡ä»¶æ´»åŠ¨æ£€æµ‹


### 7.1 æ¶æ„æ–‡ä»¶ç‰¹å¾è¯†åˆ«


**ğŸ”¸ æ¶æ„æ–‡ä»¶å¸¸è§ç‰¹å¾**ï¼š
```
æ–‡ä»¶ç‰¹å¾ï¼š
â”œâ”€â”€ å¯ç–‘æ–‡ä»¶åï¼ˆéšæœºå­—ç¬¦ã€éšè—æ–‡ä»¶ï¼‰
â”œâ”€â”€ å¼‚å¸¸ä½ç½®ï¼ˆä¸´æ—¶ç›®å½•ã€ç³»ç»Ÿç›®å½•ï¼‰
â”œâ”€â”€ å¯ç–‘æƒé™ï¼ˆå¯æ‰§è¡Œã€SUIDä½ï¼‰
â”œâ”€â”€ æ–‡ä»¶å¤§å°ï¼ˆè¶…å¤§æˆ–è¶…å°æ–‡ä»¶ï¼‰
â””â”€â”€ åˆ›å»ºæ—¶é—´ï¼ˆéå·¥ä½œæ—¶é—´åˆ›å»ºï¼‰

è¡Œä¸ºç‰¹å¾ï¼š
â”œâ”€â”€ å¿«é€Ÿåˆ›å»ºå¤§é‡æ–‡ä»¶
â”œâ”€â”€ é¢‘ç¹ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶  
â”œâ”€â”€ åœ¨å¤šä¸ªç›®å½•åˆ›å»ºç›¸åŒæ–‡ä»¶
â”œâ”€â”€ åˆ é™¤åç«‹å³é‡æ–°åˆ›å»º
â””â”€â”€ è®¿é—®å¤§é‡ç³»ç»Ÿæ–‡ä»¶
```

### 7.2 æ¶æ„æ–‡ä»¶æ£€æµ‹è§„åˆ™


**ğŸ“‹ æ£€æµ‹è§„åˆ™è®¾è®¡**ï¼š

| è§„åˆ™ç±»å‹ | **æ£€æµ‹æ¡ä»¶** | **é£é™©ç­‰çº§** | **å¤„ç†æ–¹å¼** |
|---------|-------------|-------------|-------------|
| **æ–‡ä»¶åè§„åˆ™** | éšæœºå­—ç¬¦åã€éšè—æ–‡ä»¶ | ğŸŸ¡ ä¸­ç­‰ | è®°å½•ç›‘æ§ |
| **è·¯å¾„è§„åˆ™** | ç³»ç»Ÿç›®å½•æ–°å¢å¯æ‰§è¡Œæ–‡ä»¶ | ğŸŸ  è¾ƒé«˜ | å®æ—¶å‘Šè­¦ |
| **æƒé™è§„åˆ™** | æ–°å¢SUID/SGIDæ–‡ä»¶ | ğŸ”´ é«˜å± | ç«‹å³é˜»æ–­ |
| **è¡Œä¸ºè§„åˆ™** | çŸ­æ—¶é—´å¤§é‡æ–‡ä»¶æ“ä½œ | ğŸŸ  è¾ƒé«˜ | æ·±åº¦åˆ†æ |
| **å†…å®¹è§„åˆ™** | åŒ…å«æ¶æ„ä»£ç ç‰¹å¾ | ğŸ”´ é«˜å± | éš”ç¦»å¤„ç† |

### 7.3 æ¶æ„æ–‡ä»¶ç›‘æ§å®ç°


**ğŸ”§ æ¶æ„æ–‡ä»¶æ´»åŠ¨æ£€æµ‹è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æ¶æ„æ–‡ä»¶æ´»åŠ¨æ£€æµ‹

MONITOR_DIRS=("/tmp" "/var/tmp" "/dev/shm" "/home" "/etc")
MALWARE_LOG="/var/log/malware-detection.log"

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯ç–‘
check_suspicious_file() {
    local file=$1
    local suspicious=false
    local reasons=()
    
    # æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦å¯ç–‘
    local basename=$(basename "$file")
    
    # éšæœºå­—ç¬¦æ–‡ä»¶åæ£€æŸ¥
    if [[ $basename =~ ^[a-zA-Z0-9]{8,}$ ]] && [ ${#basename} -gt 10 ]; then
        suspicious=true
        reasons+=("éšæœºå­—ç¬¦æ–‡ä»¶å")
    fi
    
    # éšè—æ–‡ä»¶æ£€æŸ¥
    if [[ $basename =~ ^\. ]] && [[ ! $basename =~ ^\.(bash|profile|ssh) ]]; then
        suspicious=true  
        reasons+=("å¯ç–‘éšè—æ–‡ä»¶")
    fi
    
    # å¯æ‰§è¡Œæ–‡ä»¶æ£€æŸ¥
    if [ -x "$file" ]; then
        local dir=$(dirname "$file")
        if [[ $dir =~ ^(/tmp|/var/tmp|/dev/shm) ]]; then
            suspicious=true
            reasons+=("ä¸´æ—¶ç›®å½•å¯æ‰§è¡Œæ–‡ä»¶")
        fi
    fi
    
    # SUID/SGIDæ£€æŸ¥
    if [ -u "$file" ] || [ -g "$file" ]; then
        suspicious=true
        reasons+=("SUID/SGIDæ–‡ä»¶")
    fi
    
    # è¾“å‡ºç»“æœ
    if [ "$suspicious" = true ]; then
        local reason_str=$(IFS=,; echo "${reasons[*]}")
        echo "ğŸš¨ å‘ç°å¯ç–‘æ–‡ä»¶: $file åŸå› : $reason_str"
        return 0
    fi
    
    return 1
}

# æ£€æŸ¥æ–‡ä»¶å†…å®¹
check_file_content() {
    local file=$1
    
    # æ£€æŸ¥æ˜¯å¦ä¸ºè„šæœ¬æ–‡ä»¶
    if [[ $file =~ \.(sh|py|pl|php)$ ]] || [ -x "$file" ]; then
        # æ£€æŸ¥æ¶æ„ä»£ç ç‰¹å¾
        local malicious_patterns=(
            "wget.*http"
            "curl.*http" 
            "nc.*-e"
            "bash.*-i"
            "python.*socket"
            "/dev/tcp"
            "base64.*decode"
        )
        
        for pattern in "${malicious_patterns[@]}"; do
            if grep -q "$pattern" "$file" 2>/dev/null; then
                echo "ğŸš¨ å‘ç°æ¶æ„ä»£ç ç‰¹å¾: $file åŒ…å«: $pattern"
                return 0
            fi
        done
    fi
    
    return 1
}

# å¯åŠ¨æ¶æ„æ–‡ä»¶ç›‘æ§
start_malware_detection() {
    echo "å¼€å§‹æ¶æ„æ–‡ä»¶æ´»åŠ¨æ£€æµ‹..."
    
    inotifywait -m -r -e create,modify,attrib "${MONITOR_DIRS[@]}" \
    --format '%T %w%f %e' --timefmt '%Y-%m-%d %H:%M:%S' |
    while read TIME FILE EVENT; do
        # è·³è¿‡ç›®å½•
        [ -d "$FILE" ] && continue
        
        # è®°å½•æ–‡ä»¶æ´»åŠ¨
        echo "[$TIME] æ–‡ä»¶æ´»åŠ¨: $FILE äº‹ä»¶: $EVENT" >> $MALWARE_LOG
        
        # æ£€æŸ¥å¯ç–‘æ–‡ä»¶
        if check_suspicious_file "$FILE"; then
            echo "[$TIME] ğŸš¨ å¯ç–‘æ–‡ä»¶æ£€æµ‹: $FILE" >> $MALWARE_LOG
            
            # æ£€æŸ¥æ–‡ä»¶å†…å®¹
            if check_file_content "$FILE"; then
                echo "[$TIME] ğŸš¨ æ¶æ„å†…å®¹æ£€æµ‹: $FILE" >> $MALWARE_LOG
                # å¯é€‰æ‹©éš”ç¦»æ–‡ä»¶
                # quarantine_file "$FILE"
            fi
        fi
    done
}
```

### 7.4 æ–‡ä»¶éš”ç¦»å¤„ç†


**ğŸ”’ æ¶æ„æ–‡ä»¶éš”ç¦»æœºåˆ¶**ï¼š
```bash
# æ–‡ä»¶éš”ç¦»å¤„ç†
quarantine_file() {
    local file=$1
    local quarantine_dir="/var/quarantine"
    local timestamp=$(date +%Y%m%d_%H%M%S)
    
    # åˆ›å»ºéš”ç¦»ç›®å½•
    mkdir -p "$quarantine_dir"
    
    # ç§»åŠ¨æ–‡ä»¶åˆ°éš”ç¦»åŒº
    local quarantine_file="$quarantine_dir/$(basename $file).$timestamp"
    mv "$file" "$quarantine_file"
    
    # è®°å½•éš”ç¦»ä¿¡æ¯
    echo "æ–‡ä»¶å·²éš”ç¦»: $file -> $quarantine_file" >> $MALWARE_LOG
    echo "åŸå§‹è·¯å¾„: $file" > "$quarantine_file.info"
    echo "éš”ç¦»æ—¶é—´: $(date)" >> "$quarantine_file.info"  
    echo "éš”ç¦»åŸå› : æ¶æ„æ–‡ä»¶æ£€æµ‹" >> "$quarantine_file.info"
    
    # å‘é€å‘Šè­¦
    echo "æ¶æ„æ–‡ä»¶å·²éš”ç¦»: $file" | mail -s "å®‰å…¨å‘Šè­¦: æ¶æ„æ–‡ä»¶éš”ç¦»" admin@company.com
}
```

---

## 8. ğŸš¨ å…¥ä¾µè¡Œä¸ºå®æ—¶å‘Šè­¦


### 8.1 å…¥ä¾µè¡Œä¸ºæ¨¡å¼è¯†åˆ«


**ğŸ”¸ å¸¸è§å…¥ä¾µè¡Œä¸ºç‰¹å¾**ï¼š
```
ç™»å½•å¼‚å¸¸ï¼š
â”œâ”€â”€ å¼‚åœ°ç™»å½•ï¼ˆIPåœ°å€å¼‚å¸¸ï¼‰
â”œâ”€â”€ æš´åŠ›ç ´è§£ï¼ˆçŸ­æ—¶é—´å¤šæ¬¡å¤±è´¥ç™»å½•ï¼‰
â”œâ”€â”€ å¼‚å¸¸æ—¶é—´ç™»å½•ï¼ˆæ·±å¤œã€èŠ‚å‡æ—¥ï¼‰
â””â”€â”€ æƒé™æå‡ï¼ˆsuã€sudoå¼‚å¸¸ä½¿ç”¨ï¼‰

æ–‡ä»¶å¼‚å¸¸ï¼š
â”œâ”€â”€ ç³»ç»Ÿæ–‡ä»¶è¢«ç¯¡æ”¹
â”œâ”€â”€ å¤§é‡æ–‡ä»¶è¢«è®¿é—®
â”œâ”€â”€ æ•æ„Ÿæ–‡ä»¶è¢«å¤åˆ¶
â””â”€â”€ æ¶æ„æ–‡ä»¶è¢«åˆ›å»º

ç½‘ç»œå¼‚å¸¸ï¼š
â”œâ”€â”€ å¼‚å¸¸ç½‘ç»œè¿æ¥
â”œâ”€â”€ å¤§é‡æ•°æ®ä¼ è¾“
â”œâ”€â”€ å¯ç–‘ç«¯å£ç›‘å¬
â””â”€â”€ å¤–è”å¯ç–‘IPåœ°å€
```

### 8.2 å®æ—¶å‘Šè­¦æœºåˆ¶è®¾è®¡


**âš¡ å‘Šè­¦è§¦å‘æµç¨‹**ï¼š
```
äº‹ä»¶æ£€æµ‹ â†’ è§„åˆ™åŒ¹é… â†’ é£é™©è¯„ä¼° â†’ å‘Šè­¦è§¦å‘ â†’ å“åº”å¤„ç†

é£é™©ç­‰çº§åˆ†ç±»ï¼š
ğŸŸ¢ ä¿¡æ¯çº§ï¼ˆINFOï¼‰    : è®°å½•æ—¥å¿—ï¼Œæ— éœ€å¤„ç†
ğŸŸ¡ è­¦å‘Šçº§ï¼ˆWARNINGï¼‰ : è®°å½•æ—¥å¿—ï¼Œé‚®ä»¶é€šçŸ¥
ğŸŸ  é”™è¯¯çº§ï¼ˆERRORï¼‰   : å®æ—¶å‘Šè­¦ï¼ŒçŸ­ä¿¡é€šçŸ¥  
ğŸ”´ ä¸¥é‡çº§ï¼ˆCRITICALï¼‰: ç«‹å³å‘Šè­¦ï¼Œç”µè¯é€šçŸ¥
```

### 8.3 å…¥ä¾µæ£€æµ‹å‘Šè­¦å®ç°


**ğŸ”§ å…¥ä¾µè¡Œä¸ºå®æ—¶æ£€æµ‹è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å…¥ä¾µè¡Œä¸ºå®æ—¶å‘Šè­¦ç³»ç»Ÿ

ALERT_LOG="/var/log/intrusion-alert.log"
CONFIG_FILE="/etc/security/alert-config.conf"

# å‘Šè­¦é…ç½®
declare -A ALERT_LEVELS=(
    ["INFO"]="ğŸŸ¢"
    ["WARNING"]="ğŸŸ¡"
    ["ERROR"]="ğŸŸ "  
    ["CRITICAL"]="ğŸ”´"
)

declare -A ALERT_ACTIONS=(
    ["INFO"]="log"
    ["WARNING"]="email"
    ["ERROR"]="sms"
    ["CRITICAL"]="call"
)

# å‘é€å‘Šè­¦
send_alert() {
    local level=$1
    local message=$2
    local source=$3
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # è®°å½•åˆ°æ—¥å¿—
    echo "[$timestamp] ${ALERT_LEVELS[$level]} [$level] $source: $message" >> $ALERT_LOG
    
    # æ ¹æ®çº§åˆ«æ‰§è¡Œç›¸åº”åŠ¨ä½œ
    case ${ALERT_ACTIONS[$level]} in
        "email")
            echo "$message" | mail -s "å®‰å…¨å‘Šè­¦ [$level]" admin@company.com
            ;;
        "sms")
            # å‘é€çŸ­ä¿¡å‘Šè­¦
            curl -X POST "http://sms-api/send" -d "phone=13800000000&message=$message"
            ;;
        "call")
            # ç”µè¯å‘Šè­¦
            echo "$message" > /tmp/alert.txt
            # è°ƒç”¨ç”µè¯å‘Šè­¦API
            ;;
    esac
}

# æ£€æµ‹æš´åŠ›ç ´è§£
detect_brute_force() {
    # ç›‘æ§SSHç™»å½•æ—¥å¿—
    tail -f /var/log/auth.log | grep "Failed password" |
    while read line; do
        local ip=$(echo "$line" | grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}')
        local user=$(echo "$line" | awk '{print $(NF-5)}')
        
        # ç»Ÿè®¡1åˆ†é’Ÿå†…å¤±è´¥æ¬¡æ•°
        local count=$(grep "Failed password" /var/log/auth.log | 
                     grep "$ip" | 
                     grep "$(date '+%b %d %H:%M')" | 
                     wc -l)
        
        if [ $count -gt 5 ]; then
            send_alert "ERROR" "æ£€æµ‹åˆ°æš´åŠ›ç ´è§£æ”»å‡»: IP $ip ç”¨æˆ· $user 1åˆ†é’Ÿå†…å¤±è´¥ $count æ¬¡" "SSH"
            
            # å¯é€‰æ‹©è‡ªåŠ¨å°ç¦IP
            # iptables -A INPUT -s $ip -j DROP
        fi
    done &
}

# æ£€æµ‹æƒé™æå‡
detect_privilege_escalation() {
    inotifywait -m /var/log/auth.log -e modify |
    while read path event; do
        # æ£€æŸ¥sudoä½¿ç”¨
        local sudo_line=$(tail -1 /var/log/auth.log | grep "sudo")
        if [ -n "$sudo_line" ]; then
            local user=$(echo "$sudo_line" | awk '{print $6}')
            local command=$(echo "$sudo_line" | cut -d':' -f4-)
            
            # æ£€æŸ¥æ˜¯å¦ä¸ºæ•æ„Ÿå‘½ä»¤
            if [[ "$command" =~ (su|passwd|visudo|chmod|chown) ]]; then
                send_alert "WARNING" "æ£€æµ‹åˆ°æƒé™æå‡æ“ä½œ: ç”¨æˆ· $user æ‰§è¡Œ $command" "SUDO"
            fi
        fi
    done &
}

# æ£€æµ‹ç³»ç»Ÿæ–‡ä»¶ç¯¡æ”¹
detect_system_tampering() {
    local system_files=("/etc/passwd" "/etc/shadow" "/etc/sudoers")
    
    inotifywait -m "${system_files[@]}" -e modify,attrib |
    while read path event file; do
        send_alert "CRITICAL" "ç³»ç»Ÿå…³é”®æ–‡ä»¶è¢«ä¿®æ”¹: $path$file äº‹ä»¶: $event" "FILE"
        
        # ç«‹å³å¤‡ä»½å½“å‰çŠ¶æ€
        cp "$path$file" "/var/backups/$(basename $file).emergency.$(date +%s)"
    done &
}

# å¯åŠ¨å…¥ä¾µæ£€æµ‹
start_intrusion_detection() {
    echo "å¯åŠ¨å…¥ä¾µè¡Œä¸ºå®æ—¶å‘Šè­¦ç³»ç»Ÿ..."
    
    # å¯åŠ¨å„ç§æ£€æµ‹
    detect_brute_force
    detect_privilege_escalation  
    detect_system_tampering
    
    # ä¿æŒè„šæœ¬è¿è¡Œ
    wait
}
```

### 8.4 å‘Šè­¦ä¿¡æ¯æ±‡æ€»


**ğŸ“Š å‘Šè­¦ç»Ÿè®¡æŠ¥å‘Š**ï¼š
```bash
# ç”Ÿæˆå‘Šè­¦ç»Ÿè®¡æŠ¥å‘Š
generate_alert_report() {
    local period=${1:-"today"}
    local report_file="/tmp/alert-report-$(date +%Y%m%d).txt"
    
    echo "=== å®‰å…¨å‘Šè­¦ç»Ÿè®¡æŠ¥å‘Š ===" > $report_file
    echo "ç»Ÿè®¡å‘¨æœŸ: $period" >> $report_file
    echo "ç”Ÿæˆæ—¶é—´: $(date)" >> $report_file
    echo >> $report_file
    
    # æŒ‰çº§åˆ«ç»Ÿè®¡
    echo "ğŸ“Š å‘Šè­¦çº§åˆ«ç»Ÿè®¡:" >> $report_file
    for level in INFO WARNING ERROR CRITICAL; do
        local count=$(grep -c "\[$level\]" $ALERT_LOG)
        echo "  ${ALERT_LEVELS[$level]} $level: $count æ¬¡" >> $report_file
    done
    echo >> $report_file
    
    # æŒ‰æ¥æºç»Ÿè®¡  
    echo "ğŸ“ˆ å‘Šè­¦æ¥æºç»Ÿè®¡:" >> $report_file
    grep "$(date +%Y-%m-%d)" $ALERT_LOG | 
    awk -F: '{print $NF}' | sort | uniq -c | sort -nr |
    while read count source; do
        echo "  $source: $count æ¬¡" >> $report_file
    done
    echo >> $report_file
    
    # æœ€è¿‘çš„ä¸¥é‡å‘Šè­¦
    echo "ğŸš¨ æœ€è¿‘çš„ä¸¥é‡å‘Šè­¦:" >> $report_file
    grep "CRITICAL" $ALERT_LOG | tail -10 >> $report_file
    
    echo "å‘Šè­¦æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

---

## 9. ğŸ“‹ åˆè§„æ€§ç›‘æ§è¦æ±‚


### 9.1 åˆè§„æ€§ç›‘æ§æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯åˆè§„æ€§ç›‘æ§**ï¼š
```
åˆè§„æ€§ç›‘æ§ = ç¡®ä¿ç³»ç»Ÿæ“ä½œç¬¦åˆç›¸å…³æ³•è§„å’Œæ ‡å‡†è¦æ±‚

ç›®çš„ï¼š
âœ… æ»¡è¶³æ³•å¾‹æ³•è§„è¦æ±‚ï¼ˆå¦‚ç½‘ç»œå®‰å…¨æ³•ï¼‰
âœ… ç¬¦åˆè¡Œä¸šæ ‡å‡†ï¼ˆå¦‚ISO27001ã€SOXï¼‰  
âœ… é€šè¿‡å®¡è®¡æ£€æŸ¥ï¼ˆå†…å®¡ã€å¤–å®¡ï¼‰
âœ… é™ä½åˆè§„é£é™©å’Œå¤„ç½š
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒå¼€è½¦è¦éµå®ˆäº¤é€šè§„åˆ™ä¸€æ ·ï¼Œç³»ç»Ÿè¿è¡Œä¹Ÿè¦éµå®ˆå„ç§å®‰å…¨è§„èŒƒï¼Œåˆè§„æ€§ç›‘æ§å°±æ˜¯ç¡®ä¿å¤§å®¶éƒ½æŒ‰è§„çŸ©åŠäº‹ã€‚

### 9.2 ä¸»è¦åˆè§„æ€§è¦æ±‚


**ğŸ“‹ å¸¸è§åˆè§„æ€§æ ‡å‡†**ï¼š

| åˆè§„æ ‡å‡† | **é€‚ç”¨åœºæ™¯** | **ä¸»è¦è¦æ±‚** | **ç›‘æ§é‡ç‚¹** |
|---------|-------------|-------------|-------------|
| **ISO27001** | ä¿¡æ¯å®‰å…¨ç®¡ç† | è®¿é—®æ§åˆ¶ã€äº‹ä»¶ç®¡ç† | ç”¨æˆ·æƒé™ã€å®‰å…¨äº‹ä»¶ |
| **SOXæ³•æ¡ˆ** | ä¸Šå¸‚å…¬å¸è´¢åŠ¡ | å†…æ§åˆ¶åº¦ã€å®¡è®¡è¿½è¸ª | è´¢åŠ¡ç³»ç»Ÿè®¿é—® |
| **GDPR** | ä¸ªäººæ•°æ®ä¿æŠ¤ | æ•°æ®è®¿é—®è®°å½• | ä¸ªäººæ•°æ®å¤„ç† |
| **ç­‰ä¿2.0** | å›½å†…ç½‘ç»œå®‰å…¨ | æ—¥å¿—è®°å½•ã€è®¿é—®æ§åˆ¶ | ç³»ç»Ÿå®‰å…¨æ—¥å¿— |
| **PCI DSS** | æ”¯ä»˜å¡è¡Œä¸š | æ•æ„Ÿæ•°æ®ä¿æŠ¤ | æ”¯ä»˜æ•°æ®è®¿é—® |

### 9.3 åˆè§„æ€§ç›‘æ§å®ç°


**ğŸ”§ åˆè§„æ€§æ—¥å¿—æ”¶é›†è„šæœ¬**ï¼š
```bash
#!/bin/bash
# åˆè§„æ€§ç›‘æ§æ—¥å¿—æ”¶é›†

COMPLIANCE_LOG="/var/log/compliance.log"
RETENTION_DAYS=2555  # 7å¹´ä¿å­˜æœŸ

# ç”¨æˆ·è®¿é—®è®°å½•ï¼ˆç¬¦åˆå®¡è®¡è¦æ±‚ï¼‰
log_user_access() {
    local user=$1
    local action=$2
    local resource=$3
    local result=$4
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local session_id=${SSH_CLIENT%% *}_$$
    
    # æ ‡å‡†åŒ–æ—¥å¿—æ ¼å¼
    echo "[$timestamp] ACCESS user=$user action=$action resource=$resource result=$result session=$session_id" >> $COMPLIANCE_LOG
}

# æƒé™å˜æ›´è®°å½•ï¼ˆç¬¦åˆå†…æ§è¦æ±‚ï¼‰
log_permission_change() {
    local admin_user=$1
    local target_user=$2  
    local old_permissions=$3
    local new_permissions=$4
    local reason=$5
    
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$timestamp] PERMISSION_CHANGE admin=$admin_user target=$target_user old=$old_permissions new=$new_permissions reason=$reason" >> $COMPLIANCE_LOG
}

# æ•°æ®è®¿é—®è®°å½•ï¼ˆç¬¦åˆæ•°æ®ä¿æŠ¤è¦æ±‚ï¼‰
log_data_access() {
    local user=$1
    local data_type=$2
    local operation=$3
    local record_count=$4
    
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$timestamp] DATA_ACCESS user=$user type=$data_type operation=$operation count=$record_count" >> $COMPLIANCE_LOG
}

# ç›‘æ§ç³»ç»Ÿç™»å½•ï¼ˆåˆè§„æ€§è¦æ±‚ï¼‰  
monitor_system_login() {
    tail -f /var/log/auth.log | grep "Accepted\|Failed" |
    while read line; do
        if echo "$line" | grep -q "Accepted"; then
            local user=$(echo "$line" | awk '{print $9}')
            local ip=$(echo "$line" | awk '{print $11}')
            log_user_access "$user" "LOGIN_SUCCESS" "SSH:$ip" "ALLOWED"
        else
            local user=$(echo "$line" | awk '{print $9}')  
            local ip=$(echo "$line" | awk '{print $11}')
            log_user_access "$user" "LOGIN_FAILED" "SSH:$ip" "DENIED"
        fi
    done &
}

# ç›‘æ§sudoæ“ä½œï¼ˆæƒé™å®¡è®¡ï¼‰
monitor_sudo_operations() {
    tail -f /var/log/auth.log | grep "sudo" |
    while read line; do
        if echo "$line" | grep -q "COMMAND"; then
            local user=$(echo "$line" | awk '{print $6}')
            local command=$(echo "$line" | cut -d':' -f4-)
            log_user_access "$user" "SUDO_EXECUTE" "$command" "ALLOWED"
        fi
    done &
}
```

### 9.4 åˆè§„æ€§æŠ¥å‘Šç”Ÿæˆ


**ğŸ“Š åˆè§„æ€§å®¡è®¡æŠ¥å‘Š**ï¼š
```bash
# ç”Ÿæˆåˆè§„æ€§å®¡è®¡æŠ¥å‘Š
generate_compliance_report() {
    local start_date=$1
    local end_date=$2
    local report_file="/var/reports/compliance-$(date +%Y%m%d).html"
    
    cat > $report_file << EOF
<!DOCTYPE html>
<html>
<head>
    <title>åˆè§„æ€§å®¡è®¡æŠ¥å‘Š</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .success { color: green; }
        .warning { color: orange; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>åˆè§„æ€§å®¡è®¡æŠ¥å‘Š</h1>
    <p>æŠ¥å‘Šå‘¨æœŸ: $start_date è‡³ $end_date</p>
    <p>ç”Ÿæˆæ—¶é—´: $(date)</p>
    
    <h2>1. ç”¨æˆ·è®¿é—®ç»Ÿè®¡</h2>
    <table>
        <tr><th>ç”¨æˆ·</th><th>ç™»å½•æ¬¡æ•°</th><th>å¤±è´¥æ¬¡æ•°</th><th>æœ€åç™»å½•</th></tr>
EOF
    
    # ç”¨æˆ·è®¿é—®ç»Ÿè®¡
    grep "LOGIN" $COMPLIANCE_LOG | 
    grep -E "$start_date|$end_date" |
    awk '{print $3}' | sed 's/user=//' | sort | uniq |
    while read user; do
        local success=$(grep "LOGIN_SUCCESS.*user=$user" $COMPLIANCE_LOG | wc -l)
        local failed=$(grep "LOGIN_FAILED.*user=$user" $COMPLIANCE_LOG | wc -l)  
        local last_login=$(grep "LOGIN_SUCCESS.*user=$user" $COMPLIANCE_LOG | tail -1 | awk '{print $1" "$2}')
        
        echo "        <tr><td>$user</td><td>$success</td><td>$failed</td><td>$last_login</td></tr>" >> $report_file
    done
    
    cat >> $report_file << EOF
    </table>
    
    <h2>2. æƒé™å˜æ›´è®°å½•</h2>
    <table>
        <tr><th>æ—¶é—´</th><th>ç®¡ç†å‘˜</th><th>ç›®æ ‡ç”¨æˆ·</th><th>å˜æ›´å†…å®¹</th><th>åŸå› </th></tr>
EOF
    
    # æƒé™å˜æ›´è®°å½•
    grep "PERMISSION_CHANGE" $COMPLIANCE_LOG |
    grep -E "$start_date|$end_date" |
    while read line; do
        local timestamp=$(echo "$line" | awk '{print $1" "$2}')
        local admin=$(echo "$line" | grep -o "admin=[^ ]*" | cut -d= -f2)
        local target=$(echo "$line" | grep -o "target=[^ ]*" | cut -d= -f2)  
        local change=$(echo "$line" | grep -o "old=[^ ]* new=[^ ]*")
        local reason=$(echo "$line" | grep -o "reason=.*" | cut -d= -f2-)
        
        echo "        <tr><td>$timestamp</td><td>$admin</td><td>$target</td><td>$change</td><td>$reason</td></tr>" >> $report_file
    done
    
    echo "    </table>" >> $report_file
    echo "</body></html>" >> $report_file
    
    echo "åˆè§„æ€§æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

---

## 10. âš¡ å®‰å…¨äº‹ä»¶å“åº”è§¦å‘


### 10.1 å®‰å…¨äº‹ä»¶å“åº”æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å®‰å…¨äº‹ä»¶å“åº”**ï¼š
```
å®‰å…¨äº‹ä»¶å“åº” = å‘ç°å®‰å…¨å¨èƒæ—¶çš„è‡ªåŠ¨åŒ–å¤„ç†æµç¨‹

å“åº”æµç¨‹ï¼š
äº‹ä»¶æ£€æµ‹ â†’ å¨èƒè¯„ä¼° â†’ è‡ªåŠ¨å“åº” â†’ äººå·¥å¹²é¢„ â†’ äº‹ååˆ†æ

å“åº”ç›®æ ‡ï¼š
âœ… å¿«é€Ÿéåˆ¶å¨èƒæ‰©æ•£
âœ… ä¿æŠ¤æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿ  
âœ… æ”¶é›†äº‹ä»¶è¯æ®
âœ… æ¢å¤æ­£å¸¸æœåŠ¡
```

### 10.2 å“åº”è§¦å‘æ¡ä»¶


**ğŸ¯ è‡ªåŠ¨å“åº”è§¦å‘åœºæ™¯**ï¼š
```
é«˜å±åœºæ™¯ï¼ˆç«‹å³å“åº”ï¼‰ï¼š
â”œâ”€â”€ ç³»ç»Ÿå…³é”®æ–‡ä»¶è¢«ç¯¡æ”¹
â”œâ”€â”€ æ£€æµ‹åˆ°æ¶æ„ä»£ç æ‰§è¡Œ
â”œâ”€â”€ å‘ç°æƒé™æå‡æ”»å‡»
â”œâ”€â”€ å¤§é‡æ•æ„Ÿæ•°æ®è¢«è®¿é—®
â””â”€â”€ å¼‚å¸¸ç½‘ç»œè¿æ¥è¡Œä¸º

ä¸­å±åœºæ™¯ï¼ˆå»¶è¿Ÿå“åº”ï¼‰ï¼š
â”œâ”€â”€ æš´åŠ›ç ´è§£æ”»å‡»
â”œâ”€â”€ å¼‚å¸¸ç”¨æˆ·è¡Œä¸º
â”œâ”€â”€ å¯ç–‘æ–‡ä»¶åˆ›å»º
â”œâ”€â”€ é…ç½®æ–‡ä»¶è¢«ä¿®æ”¹
â””â”€â”€ éæ­£å¸¸æ—¶é—´è®¿é—®
```

### 10.3 è‡ªåŠ¨åŒ–å“åº”å®ç°


**ğŸ”§ å®‰å…¨äº‹ä»¶å“åº”å¼•æ“**ï¼š
```bash
#!/bin/bash
# å®‰å…¨äº‹ä»¶è‡ªåŠ¨å“åº”ç³»ç»Ÿ

RESPONSE_LOG="/var/log/incident-response.log"
BLOCKED_IPS_FILE="/etc/security/blocked-ips.txt"

# å“åº”åŠ¨ä½œç±»å‹
declare -A RESPONSE_ACTIONS=(
    ["BLOCK_IP"]="å°ç¦IPåœ°å€"
    ["DISABLE_USER"]="ç¦ç”¨ç”¨æˆ·è´¦æˆ·"
    ["ISOLATE_FILE"]="éš”ç¦»å¯ç–‘æ–‡ä»¶"
    ["BACKUP_SYSTEM"]="ç´§æ€¥å¤‡ä»½"
    ["ALERT_ADMIN"]="é€šçŸ¥ç®¡ç†å‘˜"
    ["COLLECT_EVIDENCE"]="æ”¶é›†è¯æ®"
)

# æ‰§è¡Œå“åº”åŠ¨ä½œ
execute_response() {
    local incident_id=$1
    local action=$2
    local target=$3
    local reason=$4
    
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    case $action in
        "BLOCK_IP")
            block_malicious_ip "$target" "$reason"
            ;;
        "DISABLE_USER")  
            disable_suspicious_user "$target" "$reason"
            ;;
        "ISOLATE_FILE")
            isolate_malicious_file "$target" "$reason"  
            ;;
        "BACKUP_SYSTEM")
            create_emergency_backup "$reason"
            ;;
        "ALERT_ADMIN")
            send_emergency_alert "$target" "$reason"
            ;;
        "COLLECT_EVIDENCE")
            collect_incident_evidence "$target" "$reason"
            ;;
    esac
    
    # è®°å½•å“åº”æ—¥å¿—
    echo "[$timestamp] RESPONSE incident_id=$incident_id action=$action target=$target reason=$reason" >> $RESPONSE_LOG
}

# å°ç¦æ¶æ„IP
block_malicious_ip() {
    local ip=$1
    local reason=$2
    
    # æ·»åŠ é˜²ç«å¢™è§„åˆ™
    iptables -A INPUT -s $ip -j DROP
    
    # è®°å½•åˆ°å°ç¦åˆ—è¡¨
    echo "$ip:$(date):$reason" >> $BLOCKED_IPS_FILE
    
    echo "IPåœ°å€å·²å°ç¦: $ip åŸå› : $reason"
}

# ç¦ç”¨å¯ç–‘ç”¨æˆ·
disable_suspicious_user() {
    local user=$1
    local reason=$2
    
    # é”å®šç”¨æˆ·è´¦æˆ·
    usermod -L $user
    
    # å¼ºåˆ¶ç”¨æˆ·ä¸‹çº¿
    pkill -u $user
    
    # è®°å½•æ“ä½œ
    echo "ç”¨æˆ·å·²ç¦ç”¨: $user åŸå› : $reason" >> $RESPONSE_LOG
}

# éš”ç¦»æ¶æ„æ–‡ä»¶
isolate_malicious_file() {
    local file=$1
    local reason=$2
    local quarantine_dir="/var/quarantine"
    
    # åˆ›å»ºéš”ç¦»ç›®å½•
    mkdir -p $quarantine_dir
    
    # ç§»åŠ¨æ–‡ä»¶
    local quarantine_file="$quarantine_dir/$(basename $file).$(date +%s)"
    mv "$file" "$quarantine_file" 2>/dev/null
    
    # è®°å½•éš”ç¦»ä¿¡æ¯
    echo "æ–‡ä»¶å·²éš”ç¦»: $file -> $quarantine_file åŸå› : $reason" >> $RESPONSE_LOG
}

# ç´§æ€¥å¤‡ä»½
create_emergency_backup() {
    local reason=$1
    local backup_dir="/var/emergency-backup/$(date +%Y%m%d_%H%M%S)"
    
    mkdir -p $backup_dir
    
    # å¤‡ä»½å…³é”®æ–‡ä»¶
    cp -r /etc $backup_dir/
    cp -r /var/log $backup_dir/
    cp /etc/passwd $backup_dir/
    cp /etc/shadow $backup_dir/
    
    echo "ç´§æ€¥å¤‡ä»½å®Œæˆ: $backup_dir åŸå› : $reason" >> $RESPONSE_LOG
}

# å‘é€ç´§æ€¥å‘Šè­¦
send_emergency_alert() {
    local target=$1
    local reason=$2
    
    local message="ğŸš¨ å®‰å…¨äº‹ä»¶ç´§æ€¥å“åº”\næ—¶é—´: $(date)\nç›®æ ‡: $target\nåŸå› : $reason"
    
    # å‘é€é‚®ä»¶
    echo -e "$message" | mail -s "ç´§æ€¥å®‰å…¨å“åº”" admin@company.com
    
    # å‘é€çŸ­ä¿¡ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
    # curl -X POST "http://sms-api/emergency" -d "message=$message"
}

# æ”¶é›†äº‹ä»¶è¯æ®
collect_incident_evidence() {
    local target=$1
    local reason=$2
    local evidence_dir="/var/evidence/$(date +%Y%m%d_%H%M%S)"
    
    mkdir -p $evidence_dir
    
    # æ”¶é›†ç³»ç»ŸçŠ¶æ€
    ps aux > $evidence_dir/processes.txt
    netstat -tulpn > $evidence_dir/network.txt
    df -h > $evidence_dir/disk.txt
    
    # æ”¶é›†ç›¸å…³æ—¥å¿—
    cp /var/log/auth.log $evidence_dir/
    cp /var/log/syslog $evidence_dir/
    
    # å¦‚æœæ˜¯æ–‡ä»¶ç›¸å…³äº‹ä»¶ï¼Œå¤‡ä»½æ–‡ä»¶ä¿¡æ¯
    if [ -f "$target" ]; then
        ls -la "$target" > $evidence_dir/file_info.txt
        file "$target" > $evidence_dir/file_type.txt
        md5sum "$target" > $evidence_dir/file_hash.txt
    fi
    
    echo "è¯æ®æ”¶é›†å®Œæˆ: $evidence_dir" >> $RESPONSE_LOG
}
```

### 10.4 å“åº”ç­–ç•¥é…ç½®


**âš™ï¸ å“åº”ç­–ç•¥é…ç½®æ–‡ä»¶**ï¼š
```bash
# /etc/security/response-rules.conf
# å®‰å…¨äº‹ä»¶å“åº”è§„åˆ™é…ç½®

# è§„åˆ™æ ¼å¼: äº‹ä»¶ç±»å‹:è§¦å‘æ¡ä»¶:å“åº”åŠ¨ä½œ:å“åº”çº§åˆ«

# æš´åŠ›ç ´è§£å“åº”
BRUTE_FORCE:failed_attempts>5:BLOCK_IP,ALERT_ADMIN:HIGH

# æƒé™æå‡å“åº”  
PRIVILEGE_ESCALATION:sudo_command=passwd|visudo:DISABLE_USER,ALERT_ADMIN:CRITICAL

# ç³»ç»Ÿæ–‡ä»¶ç¯¡æ”¹å“åº”
SYSTEM_TAMPERING:file=/etc/passwd|/etc/shadow:BACKUP_SYSTEM,ISOLATE_FILE,ALERT_ADMIN:CRITICAL

# æ¶æ„æ–‡ä»¶å“åº”
MALWARE_DETECTED:file_type=executable,location=/tmp:ISOLATE_FILE,COLLECT_EVIDENCE:HIGH

# å¼‚å¸¸è®¿é—®å“åº”
ABNORMAL_ACCESS:time=night,location=sensitive:ALERT_ADMIN,COLLECT_EVIDENCE:MEDIUM

# åŠ è½½å“åº”è§„åˆ™
load_response_rules() {
    local rules_file="/etc/security/response-rules.conf"
    
    while IFS=: read -r event_type condition actions level; do
        # è·³è¿‡æ³¨é‡Šè¡Œ
        [[ $event_type =~ ^#.*$ ]] && continue
        
        # è§£æè§„åˆ™
        echo "åŠ è½½å“åº”è§„åˆ™: $event_type -> $actions ($level)"
        
        # è¿™é‡Œå¯ä»¥å°†è§„åˆ™å­˜å‚¨åˆ°æ•°ç»„æˆ–æ•°æ®åº“ä¸­
        # ä¾›äº‹ä»¶å¤„ç†æ—¶æŸ¥è¯¢ä½¿ç”¨
    done < $rules_file
}
```

---

## 11. ğŸ“Š å®¡è®¡æ—¥å¿—è§„èŒƒåŒ–å­˜å‚¨


### 11.1 å®¡è®¡æ—¥å¿—è§„èŒƒæ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å®¡è®¡æ—¥å¿—è§„èŒƒåŒ–**ï¼š
```
å®¡è®¡æ—¥å¿—è§„èŒƒåŒ– = ç»Ÿä¸€æ—¥å¿—æ ¼å¼ + ç»“æ„åŒ–å­˜å‚¨ + ä¾¿äºåˆ†æ

ç›®çš„ï¼š
âœ… ç»Ÿä¸€æ—¥å¿—æ ¼å¼æ ‡å‡†
âœ… ä¾¿äºè‡ªåŠ¨åŒ–åˆ†æ  
âœ… æ»¡è¶³åˆè§„æ€§è¦æ±‚
âœ… æ”¯æŒé•¿æœŸå½’æ¡£
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒæŠŠå„ç§ä¸åŒæ ¼å¼çš„æ–‡æ¡£éƒ½æ•´ç†æˆç»Ÿä¸€çš„æ¡£æ¡ˆæ ¼å¼ï¼Œè¿™æ ·æŸ¥æ‰¾å’Œåˆ†æå°±æ–¹ä¾¿å¤šäº†ã€‚

### 11.2 æ—¥å¿—æ ¼å¼æ ‡å‡†åŒ–


**ğŸ“‹ æ ‡å‡†æ—¥å¿—æ ¼å¼è®¾è®¡**ï¼š
```json
{
    "timestamp": "2024-01-15T10:30:45.123Z",
    "event_id": "EVT-20240115-001",
    "event_type": "FILE_ACCESS",
    "severity": "INFO",
    "source": {
        "hostname": "web-server-01",
        "ip": "192.168.1.100",
        "service": "inotify-monitor"
    },
    "user": {
        "username": "john",
        "uid": "1001",
        "group": "developers"
    },
    "action": {
        "operation": "READ",
        "resource": "/var/www/config.php",
        "result": "SUCCESS"
    },
    "metadata": {
        "file_size": "2048",
        "permissions": "644",
        "process": "nginx"
    }
}
```

### 11.3 æ—¥å¿—å­˜å‚¨æ¶æ„


**ğŸ—ï¸ æ—¥å¿—å­˜å‚¨æ¶æ„å›¾**ï¼š
```
åº”ç”¨ç¨‹åº          æ—¥å¿—æ”¶é›†å±‚         æ—¥å¿—å­˜å‚¨å±‚         æ—¥å¿—åˆ†æå±‚
    |                  |                  |                 |
inotifyç›‘æ§     â†’   rsyslog/fluentd  â†’   æ•°æ®åº“/æ–‡ä»¶   â†’   åˆ†æå·¥å…·
SSHç™»å½•æ—¥å¿—     â†’        |            â†’     |         â†’       |
ç³»ç»Ÿå®¡è®¡æ—¥å¿—    â†’        |            â†’     |         â†’   å¯è§†åŒ–ç•Œé¢
å®‰å…¨äº‹ä»¶æ—¥å¿—    â†’        |            â†’     |         â†’   æŠ¥è¡¨ç”Ÿæˆ
    |                  |                  |                 |
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ ‡å‡†åŒ–æ ¼å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç´¢å¼•æ£€ç´¢ â”€â”€â”€â”€â”€â”€ æŸ¥è¯¢åˆ†æ
```

### 11.4 æ—¥å¿—è§„èŒƒåŒ–å®ç°


**ğŸ”§ æ—¥å¿—è§„èŒƒåŒ–å¤„ç†è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å®¡è®¡æ—¥å¿—è§„èŒƒåŒ–å¤„ç†

LOG_DIR="/var/log/audit"
NORMALIZED_LOG="$LOG_DIR/normalized-audit.jsonl"
DB_CONFIG="/etc/audit/db-config.conf"

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p $LOG_DIR

# æ—¥å¿—ç»“æ„åŒ–å¤„ç†
normalize_log_entry() {
    local timestamp=$1
    local event_type=$2
    local severity=$3
    local user=$4
    local action=$5
    local resource=$6
    local result=$7
    local metadata=$8
    
    # ç”Ÿæˆäº‹ä»¶ID
    local event_id="EVT-$(date +%Y%m%d)-$(printf "%06d" $RANDOM)"
    
    # è·å–ç³»ç»Ÿä¿¡æ¯
    local hostname=$(hostname)
    local ip=$(hostname -I | awk '{print $1}')
    
    # æ„å»ºJSONæ ¼å¼æ—¥å¿—
    local json_log=$(cat << EOF
{
    "timestamp": "$timestamp",
    "event_id": "$event_id", 
    "event_type": "$event_type",
    "severity": "$severity",
    "source": {
        "hostname": "$hostname",
        "ip": "$ip",
        "service": "inotify-audit"
    },
    "user": {
        "username": "$user",
        "uid": "$(id -u $user 2>/dev/null || echo 'unknown')",
        "group": "$(id -gn $user 2>/dev/null || echo 'unknown')"
    },
    "action": {
        "operation": "$action",
        "resource": "$resource", 
        "result": "$result"
    },
    "metadata": $metadata
}
EOF
    )
    
    # å†™å…¥è§„èŒƒåŒ–æ—¥å¿—æ–‡ä»¶
    echo "$json_log" >> $NORMALIZED_LOG
    
    # å¦‚æœé…ç½®äº†æ•°æ®åº“ï¼ŒåŒæ—¶å†™å…¥æ•°æ®åº“
    if [ -f "$DB_CONFIG" ]; then
        store_to_database "$json_log"
    fi
}

# å­˜å‚¨åˆ°æ•°æ®åº“
store_to_database() {
    local json_log=$1
    
    # è¯»å–æ•°æ®åº“é…ç½®
    source $DB_CONFIG
    
    # ä½¿ç”¨MySQLå­˜å‚¨ï¼ˆç¤ºä¾‹ï¼‰
    if [ "$DB_TYPE" = "mysql" ]; then
        mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME << EOF
INSERT INTO audit_logs (
    event_id, timestamp, event_type, severity,
    hostname, ip, username, operation, resource, result, metadata
) VALUES (
    '$(echo "$json_log" | jq -r .event_id)',
    '$(echo "$json_log" | jq -r .timestamp)',
    '$(echo "$json_log" | jq -r .event_type)',
    '$(echo "$json_log" | jq -r .severity)',
    '$(echo "$json_log" | jq -r .source.hostname)',
    '$(echo "$json_log" | jq -r .source.ip)',
    '$(echo "$json_log" | jq -r .user.username)',
    '$(echo "$json_log" | jq -r .action.operation)',
    '$(echo "$json_log" | jq -r .action.resource)',
    '$(echo "$json_log" | jq -r .action.result)',
    '$(echo "$json_log" | jq -r .metadata)'
);
EOF
    fi
}

# inotifyäº‹ä»¶è½¬æ¢ä¸ºè§„èŒƒåŒ–æ—¥å¿—
convert_inotify_event() {
    local raw_log=$1
    
    # è§£æåŸå§‹æ—¥å¿—: [2024-01-15 10:30:45] /etc/passwd MODIFY john
    local timestamp=$(echo "$raw_log" | grep -o '\[.*\]' | tr -d '[]')
    local file=$(echo "$raw_log" | awk '{print $3}')
    local event=$(echo "$raw_log" | awk '{print $4}')  
    local user=$(echo "$raw_log" | awk '{print $5}')
    
    # è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
    local iso_timestamp=$(date -d "$timestamp" -Iseconds)
    
    # æ„å»ºmetadata
    local metadata="{}"
    if [ -f "$file" ]; then
        local file_size=$(stat -c%s "$file" 2>/dev/null || echo "0")
        local permissions=$(stat -c%a "$file" 2>/dev/null || echo "000")
        metadata=$(cat << EOF
{
    "file_size": "$file_size",
    "permissions": "$permissions",
    "file_type": "$(file -b "$file" 2>/dev/null || echo 'unknown')"
}
EOF
        )
    fi
    
    # è°ƒç”¨è§„èŒƒåŒ–å‡½æ•°
    normalize_log_entry "$iso_timestamp" "FILE_ACCESS" "INFO" "$user" "$event" "$file" "SUCCESS" "$metadata"
}

# æ—¥å¿—è½®è½¬å’Œå½’æ¡£
rotate_audit_logs() {
    local max_size="100M"
    local retention_days="2555"  # 7å¹´ä¿å­˜æœŸ
    
    # æ£€æŸ¥æ—¥å¿—å¤§å°
    if [ -f "$NORMALIZED_LOG" ]; then
        local file_size=$(stat -c%s "$NORMALIZED_LOG")
        local max_bytes=$((100*1024*1024))  # 100MB
        
        if [ $file_size -gt $max_bytes ]; then
            # è½®è½¬æ—¥å¿—
            local archive_name="$LOG_DIR/audit-$(date +%Y%m%d_%H%M%S).jsonl.gz"
            gzip -c "$NORMALIZED_LOG" > "$archive_name"
            > "$NORMALIZED_LOG"  # æ¸…ç©ºå½“å‰æ—¥å¿—æ–‡ä»¶
            
            echo "æ—¥å¿—å·²è½®è½¬: $archive_name"
        fi
    fi
    
    # æ¸…ç†è¿‡æœŸæ—¥å¿—
    find "$LOG_DIR" -name "audit-*.jsonl.gz" -mtime +$retention_days -delete
}

# æ—¥å¿—ç´¢å¼•åˆ›å»ºï¼ˆç”¨äºå¿«é€Ÿæ£€ç´¢ï¼‰
create_log_index() {
    local index_file="$LOG_DIR/audit-index.txt"
    local date_today=$(date +%Y-%m-%d)
    
    # åˆ›å»ºå½“æ—¥æ—¥å¿—ç´¢å¼•
    grep "$date_today" "$NORMALIZED_LOG" | 
    jq -r '"[\(.timestamp)] \(.event_type) \(.user.username) \(.action.resource)"' > "$index_file"
    
    echo "æ—¥å¿—ç´¢å¼•å·²æ›´æ–°: $index_file"
}
```

### 11.5 æ—¥å¿—æŸ¥è¯¢å’Œåˆ†æ


**ğŸ” æ—¥å¿—æŸ¥è¯¢æ¥å£**ï¼š
```bash
#!/bin/bash
# å®¡è®¡æ—¥å¿—æŸ¥è¯¢å·¥å…·

NORMALIZED_LOG="/var/log/audit/normalized-audit.jsonl"

# æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢
query_by_timerange() {
    local start_time=$1
    local end_time=$2
    
    echo "æŸ¥è¯¢æ—¶é—´èŒƒå›´: $start_time è‡³ $end_time"
    
    jq -r --arg start "$start_time" --arg end "$end_time" '
        select(.timestamp >= $start and .timestamp <= $end) |
        "[\(.timestamp)] \(.event_type) \(.user.username) \(.action.operation) \(.action.resource)"
    ' "$NORMALIZED_LOG"
}

# æŒ‰ç”¨æˆ·æŸ¥è¯¢
query_by_user() {
    local username=$1
    
    echo "æŸ¥è¯¢ç”¨æˆ·: $username"
    
    jq -r --arg user "$username" '
        select(.user.username == $user) |
        "[\(.timestamp)] \(.event_type) \(.action.operation) \(.action.resource) \(.action.result)"
    ' "$NORMALIZED_LOG"
}

# æŒ‰äº‹ä»¶ç±»å‹æŸ¥è¯¢
query_by_event_type() {
    local event_type=$1
    
    echo "æŸ¥è¯¢äº‹ä»¶ç±»å‹: $event_type"
    
    jq -r --arg type "$event_type" '
        select(.event_type == $type) |
        "[\(.timestamp)] \(.user.username) \(.action.operation) \(.action.resource)"
    ' "$NORMALIZED_LOG"
}

# å®‰å…¨äº‹ä»¶æ±‡æ€»
security_summary() {
    local date=${1:-$(date +%Y-%m-%d)}
    
    echo "=== $date å®‰å…¨äº‹ä»¶æ±‡æ€» ==="
    echo
    
    # æŒ‰ä¸¥é‡ç¨‹åº¦ç»Ÿè®¡
    echo "ğŸ“Š æŒ‰ä¸¥é‡ç¨‹åº¦ç»Ÿè®¡:"
    jq -r --arg date "$date" '
        select(.timestamp | startswith($date)) |
        .severity
    ' "$NORMALIZED_LOG" | sort | uniq -c | 
    while read count severity; do
        case $severity in
            "CRITICAL") echo "  ğŸ”´ ä¸¥é‡: $count ä»¶" ;;
            "ERROR")    echo "  ğŸŸ  é”™è¯¯: $count ä»¶" ;;
            "WARNING")  echo "  ğŸŸ¡ è­¦å‘Š: $count ä»¶" ;;
            "INFO")     echo "  ğŸŸ¢ ä¿¡æ¯: $count ä»¶" ;;
        esac
    done
    echo
    
    # æŒ‰äº‹ä»¶ç±»å‹ç»Ÿè®¡
    echo "ğŸ“ˆ æŒ‰äº‹ä»¶ç±»å‹ç»Ÿè®¡:"
    jq -r --arg date "$date" '
        select(.timestamp | startswith($date)) |
        .event_type  
    ' "$NORMALIZED_LOG" | sort | uniq -c | sort -nr |
    while read count type; do
        echo "  $type: $count æ¬¡"
    done
    echo
    
    # æœ€æ´»è·ƒç”¨æˆ·
    echo "ğŸ‘¤ æœ€æ´»è·ƒç”¨æˆ· TOP 5:"
    jq -r --arg date "$date" '
        select(.timestamp | startswith($date)) |
        .user.username
    ' "$NORMALIZED_LOG" | sort | uniq -c | sort -nr | head -5 |
    while read count user; do
        echo "  $user: $count æ¬¡æ“ä½œ"
    done
}

# å¼‚å¸¸æ£€æµ‹åˆ†æ
detect_anomalies() {
    echo "ğŸ” å¼‚å¸¸è¡Œä¸ºæ£€æµ‹:"
    echo
    
    # æ£€æµ‹æ·±å¤œæ´»åŠ¨
    echo "ğŸŒ™ æ·±å¤œæ´»åŠ¨ (22:00-06:00):"
    jq -r '
        select(.timestamp | strptime("%Y-%m-%dT%H:%M:%S") | 
               (.[3] >= 22 or .[3] <= 6)) |
        "[\(.timestamp)] \(.user.username) \(.action.operation) \(.action.resource)"
    ' "$NORMALIZED_LOG" | tail -10
    echo
    
    # æ£€æµ‹é¢‘ç¹å¤±è´¥æ“ä½œ
    echo "âŒ é¢‘ç¹å¤±è´¥æ“ä½œ:"
    jq -r '
        select(.action.result == "FAILURE") |
        "\(.user.username) \(.action.operation)"  
    ' "$NORMALIZED_LOG" | sort | uniq -c | sort -nr | head -5 |
    while read count operation; do
        echo "  $operation: $count æ¬¡å¤±è´¥"
    done
    echo
    
    # æ£€æµ‹æ•æ„Ÿæ–‡ä»¶è®¿é—®
    echo "ğŸ”’ æ•æ„Ÿæ–‡ä»¶è®¿é—®:"
    jq -r '
        select(.action.resource | test("/etc/(passwd|shadow|sudoers)")) |
        "[\(.timestamp)] \(.user.username) \(.action.operation) \(.action.resource)"
    ' "$NORMALIZED_LOG" | tail -10
}
```

### 11.6 æ—¥å¿—å¯è§†åŒ–å±•ç¤º


**ğŸ“ˆ æ—¥å¿—æ•°æ®å¯è§†åŒ–è„šæœ¬**ï¼š
```bash
#!/bin/bash
# ç”Ÿæˆå®¡è®¡æ—¥å¿—å¯è§†åŒ–æŠ¥å‘Š

generate_dashboard() {
    local output_file="/var/www/html/audit-dashboard.html"
    local date_range=${1:-"last_7_days"}
    
    cat > "$output_file" << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <title>ç³»ç»Ÿå®¡è®¡ç›‘æ§é¢æ¿</title>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .metric { text-align: center; padding: 20px; }
        .metric h3 { margin: 0; color: #333; }
        .metric .number { font-size: 2em; font-weight: bold; color: #007bff; }
        .chart-container { width: 100%; height: 300px; }
        .alert-high { border-left: 4px solid #dc3545; }
        .alert-medium { border-left: 4px solid #ffc107; }
        .alert-low { border-left: 4px solid #28a745; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; }
    </style>
</head>
<body>
    <h1>ğŸ›¡ï¸ ç³»ç»Ÿå®¡è®¡ç›‘æ§é¢æ¿</h1>
    <p>æ›´æ–°æ—¶é—´: <span id="updateTime"></span></p>
    
    <div class="dashboard">
        <div class="card">
            <h2>ğŸ“Š ä»Šæ—¥ç»Ÿè®¡æ¦‚è§ˆ</h2>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                <div class="metric">
                    <h3>æ€»äº‹ä»¶æ•°</h3>
                    <div class="number" id="totalEvents">-</div>
                </div>
                <div class="metric">
                    <h3>å®‰å…¨å‘Šè­¦</h3>
                    <div class="number" id="securityAlerts" style="color: #dc3545;">-</div>
                </div>
                <div class="metric">
                    <h3>æ´»è·ƒç”¨æˆ·</h3>
                    <div class="number" id="activeUsers">-</div>
                </div>
                <div class="metric">
                    <h3>æ–‡ä»¶æ“ä½œ</h3>
                    <div class="number" id="fileOperations">-</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸ“ˆ äº‹ä»¶è¶‹åŠ¿å›¾</h2>
            <div class="chart-container">
                <canvas id="eventTrendChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸ” äº‹ä»¶ç±»å‹åˆ†å¸ƒ</h2>
            <div class="chart-container">
                <canvas id="eventTypeChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h2>âš ï¸ æœ€æ–°å®‰å…¨äº‹ä»¶</h2>
            <table id="recentEvents">
                <thead>
                    <tr><th>æ—¶é—´</th><th>ç±»å‹</th><th>ç”¨æˆ·</th><th>æ“ä½œ</th><th>èµ„æº</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    
    <script>
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        document.getElementById('updateTime').textContent = new Date().toLocaleString();
        
        // è¿™é‡Œå¯ä»¥é€šè¿‡AJAXåŠ è½½å®é™…æ•°æ®
        // ä¸ºäº†æ¼”ç¤ºï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
        
        // æ›´æ–°ç»Ÿè®¡æ•°å­—
        document.getElementById('totalEvents').textContent = '1,234';
        document.getElementById('securityAlerts').textContent = '8';
        document.getElementById('activeUsers').textContent = '45';
        document.getElementById('fileOperations').textContent = '892';
        
        // äº‹ä»¶è¶‹åŠ¿å›¾
        const trendCtx = document.getElementById('eventTrendChart').getContext('2d');
        new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                datasets: [{
                    label: 'äº‹ä»¶æ•°é‡',
                    data: [12, 8, 45, 78, 92, 67],
                    borderColor: '#007bff',
                    fill: false
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
        
        // äº‹ä»¶ç±»å‹åˆ†å¸ƒå›¾
        const typeCtx = document.getElementById('eventTypeChart').getContext('2d');
        new Chart(typeCtx, {
            type: 'doughnut',
            data: {
                labels: ['æ–‡ä»¶è®¿é—®', 'ç™»å½•äº‹ä»¶', 'æƒé™å˜æ›´', 'ç³»ç»Ÿæ“ä½œ'],
                datasets: [{
                    data: [45, 25, 15, 15],
                    backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545']
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    </script>
</body>
</html>
EOF

    echo "å®¡è®¡ç›‘æ§é¢æ¿å·²ç”Ÿæˆ: $output_file"
}
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ inotifyæ ¸å¿ƒç†è§£**ï¼š
```
æœ¬è´¨æ¦‚å¿µï¼šLinuxå†…æ ¸æä¾›çš„æ–‡ä»¶ç³»ç»Ÿå®æ—¶äº‹ä»¶ç›‘æ§æœºåˆ¶
å·¥ä½œåŸç†ï¼šäº‹ä»¶é©±åŠ¨ï¼Œæ–‡ä»¶å˜åŒ–æ—¶å†…æ ¸ç«‹å³é€šçŸ¥åº”ç”¨ç¨‹åº
æ ¸å¿ƒä¼˜åŠ¿ï¼šå®æ—¶æ€§å¼ºã€èµ„æºæ¶ˆè€—ä½ã€ä¿¡æ¯è¯¦ç»†
åº”ç”¨ä»·å€¼ï¼šå®‰å…¨ç›‘æ§ã€è‡ªåŠ¨åŒ–è¿ç»´ã€åˆè§„å®¡è®¡
```

**ğŸ”¸ ç›‘æ§ç­–ç•¥è®¾è®¡**ï¼š
```
åˆ†å±‚ç›‘æ§ï¼šæ ¹æ®é‡è¦æ€§è®¾ç½®ä¸åŒç›‘æ§çº§åˆ«
äº‹ä»¶åˆ†ç±»ï¼šè®¿é—®ã€ä¿®æ”¹ã€åˆ›å»ºã€åˆ é™¤ã€å±æ€§å˜æ›´
å“åº”æœºåˆ¶ï¼šè®°å½•æ—¥å¿—ã€å®æ—¶å‘Šè­¦ã€è‡ªåŠ¨å¤„ç†
å­˜å‚¨è§„èŒƒï¼šç»“æ„åŒ–æ—¥å¿—ã€é•¿æœŸå½’æ¡£ã€ä¾¿äºåˆ†æ
```

### 12.2 å®é™…åº”ç”¨åœºæ™¯æŒæ¡


**ğŸ“Š åº”ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

| åº”ç”¨åœºæ™¯ | **ç›‘æ§é‡ç‚¹** | **å“åº”æ–¹å¼** | **æŠ€æœ¯è¦ç‚¹** |
|---------|-------------|-------------|-------------|
| **ç³»ç»Ÿå®‰å…¨ç›‘æ§** | å…³é”®æ–‡ä»¶ç¯¡æ”¹ã€æƒé™å¼‚å¸¸ | å®æ—¶å‘Šè­¦ã€è‡ªåŠ¨é˜»æ–­ | é«˜å±æ–‡ä»¶ç›‘æ§ã€å…¥ä¾µæ£€æµ‹ |
| **åˆè§„æ€§å®¡è®¡** | ç”¨æˆ·æ“ä½œè®°å½•ã€æ•°æ®è®¿é—® | æ—¥å¿—è®°å½•ã€å®šæœŸæŠ¥å‘Š | æ ‡å‡†åŒ–æ—¥å¿—ã€é•¿æœŸå­˜å‚¨ |
| **è¿ç»´è‡ªåŠ¨åŒ–** | é…ç½®æ–‡ä»¶å˜æ›´ã€æœåŠ¡çŠ¶æ€ | è‡ªåŠ¨åŒæ­¥ã€æœåŠ¡é‡å¯ | äº‹ä»¶è§¦å‘ã€è„šæœ¬æ‰§è¡Œ |
| **å¼€å‘è°ƒè¯•** | ä»£ç æ–‡ä»¶å˜åŒ–ã€æ—¥å¿—äº§ç”Ÿ | è‡ªåŠ¨ç¼–è¯‘ã€å®æ—¶åŒæ­¥ | æ–‡ä»¶ç›‘æ§ã€å¢é‡å¤„ç† |

### 12.3 æŠ€æœ¯å®ç°è¦ç‚¹


**ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æŒæ¡**ï¼š
- **inotify APIä½¿ç”¨**ï¼š`inotifywait`å‘½ä»¤ã€äº‹ä»¶ç±»å‹ã€ç›‘æ§å‚æ•°
- **è„šæœ¬ç¼–ç¨‹æŠ€å·§**ï¼šäº‹ä»¶å¤„ç†å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ã€æ—¥å¿—è®°å½•
- **å®‰å…¨å“åº”æœºåˆ¶**ï¼šè‡ªåŠ¨é˜»æ–­ã€æ–‡ä»¶éš”ç¦»ã€å‘Šè­¦é€šçŸ¥
- **æ—¥å¿—ç®¡ç†**ï¼šæ ‡å‡†åŒ–æ ¼å¼ã€è½®è½¬å½’æ¡£ã€æŸ¥è¯¢åˆ†æ

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
```
æ€§èƒ½è€ƒè™‘ï¼š
- é¿å…ç›‘æ§è¿‡å¤§ç›®å½•æ ‘
- åˆç†è®¾ç½®äº‹ä»¶ç±»å‹è¿‡æ»¤
- å®šæœŸæ¸…ç†ç›‘æ§å®ä¾‹

å®‰å…¨è€ƒè™‘ï¼š
- ç›‘æ§è„šæœ¬æœ¬èº«çš„å®‰å…¨æ€§
- æ—¥å¿—æ–‡ä»¶çš„è®¿é—®æƒé™æ§åˆ¶
- æ•æ„Ÿä¿¡æ¯çš„è„±æ•å¤„ç†

ç¨³å®šæ€§è€ƒè™‘ï¼š  
- å¤„ç†å¤§é‡å¹¶å‘äº‹ä»¶
- å¼‚å¸¸æƒ…å†µçš„å®¹é”™å¤„ç†
- ç›‘æ§è¿›ç¨‹çš„è‡ªåŠ¨é‡å¯
```

### 12.4 å­¦ä¹ å»ºè®®å’Œå®è·µæ–¹å‘


**ğŸ“š å­¦ä¹ è·¯å¾„å»ºè®®**ï¼š
```
1. åŸºç¡€å®è·µï¼ˆå…¥é—¨ï¼‰
   â”œâ”€â”€ å­¦ä¹ inotifywaitåŸºæœ¬ç”¨æ³•
   â”œâ”€â”€ ç¼–å†™ç®€å•çš„æ–‡ä»¶ç›‘æ§è„šæœ¬
   â””â”€â”€ ç†è§£å„ç§äº‹ä»¶ç±»å‹å«ä¹‰

2. è¿›é˜¶åº”ç”¨ï¼ˆæé«˜ï¼‰
   â”œâ”€â”€ è®¾è®¡å¤æ‚ç›‘æ§ç­–ç•¥
   â”œâ”€â”€ å®ç°è‡ªåŠ¨åŒ–å“åº”æœºåˆ¶
   â””â”€â”€ é›†æˆç°æœ‰ç›‘æ§ç³»ç»Ÿ

3. é«˜çº§åº”ç”¨ï¼ˆç²¾é€šï¼‰
   â”œâ”€â”€ å¤§è§„æ¨¡ç›‘æ§ç³»ç»Ÿè®¾è®¡
   â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–å’Œæ•…éšœå¤„ç†
   â””â”€â”€ å®‰å…¨åŠ å›ºå’Œåˆè§„å®ç°
```

**ğŸ¯ å®è·µå»ºè®®**ï¼š
- **ä»å°åšèµ·**ï¼šå…ˆç›‘æ§å‡ ä¸ªé‡è¦æ–‡ä»¶ï¼Œé€æ­¥æ‰©å±•
- **æ³¨é‡å®‰å…¨**ï¼šç¡®ä¿ç›‘æ§ç³»ç»Ÿæœ¬èº«çš„å®‰å…¨æ€§
- **æŒç»­ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ç›‘æ§ç­–ç•¥
- **æ–‡æ¡£è®°å½•**ï¼šè®°å½•ç›‘æ§è§„åˆ™å’Œå¤„ç†æµç¨‹
- **å®šæœŸæ£€æŸ¥**ï¼šéªŒè¯ç›‘æ§ç³»ç»Ÿçš„æœ‰æ•ˆæ€§

**ğŸ’¡ æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- inotifyç›‘æ§å®æ—¶å¼ºï¼Œæ–‡ä»¶å˜åŒ–ç«‹çŸ¥æ™“
- åˆ†çº§ç›‘æ§ç­–ç•¥æ¸…ï¼Œå…³é”®æ–‡ä»¶é‡ç‚¹é˜²  
- æ—¥å¿—è§„èŒƒç»“æ„åŒ–ï¼ŒæŸ¥è¯¢åˆ†ææ•ˆç‡é«˜
- è‡ªåŠ¨å“åº”å¤„ç†å¿«ï¼Œå®‰å…¨å¨èƒæ—©å‘ç°