---
title: 7ã€æ–‡ä»¶åŒæ­¥ä¸è‡ªåŠ¨åŒ–åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [å®æ—¶æ–‡ä»¶åŒæ­¥æœºåˆ¶](#1-å®æ—¶æ–‡ä»¶åŒæ­¥æœºåˆ¶)
2. [rsyncç»“åˆinotifyè‡ªåŠ¨åŒæ­¥](#2-rsyncç»“åˆinotifyè‡ªåŠ¨åŒæ­¥)
3. [é…ç½®æ–‡ä»¶å˜æ›´è‡ªåŠ¨é‡è½½](#3-é…ç½®æ–‡ä»¶å˜æ›´è‡ªåŠ¨é‡è½½)
4. [æ—¥å¿—æ–‡ä»¶è½®è½¬ç›‘æ§](#4-æ—¥å¿—æ–‡ä»¶è½®è½¬ç›‘æ§)
5. [Webåº”ç”¨çƒ­éƒ¨ç½²è§¦å‘](#5-webåº”ç”¨çƒ­éƒ¨ç½²è§¦å‘)
6. [æ•°æ®åº“å¤‡ä»½è‡ªåŠ¨è§¦å‘](#6-æ•°æ®åº“å¤‡ä»½è‡ªåŠ¨è§¦å‘)
7. [æ–‡ä»¶ä¸Šä¼ å®Œæˆæ£€æµ‹](#7-æ–‡ä»¶ä¸Šä¼ å®Œæˆæ£€æµ‹)
8. [æ‰¹å¤„ç†ä»»åŠ¡è‡ªåŠ¨å¯åŠ¨](#8-æ‰¹å¤„ç†ä»»åŠ¡è‡ªåŠ¨å¯åŠ¨)
9. [å·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–é›†æˆ](#9-å·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–é›†æˆ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ å®æ—¶æ–‡ä»¶åŒæ­¥æœºåˆ¶


### 1.1 ä»€ä¹ˆæ˜¯å®æ—¶æ–‡ä»¶åŒæ­¥


**ç®€å•ç†è§£**ï¼šå®æ—¶æ–‡ä»¶åŒæ­¥å°±åƒ**è‡ªåŠ¨ä¿å­˜åŠŸèƒ½**ï¼Œå½“ä½ åœ¨ä¸€ä¸ªåœ°æ–¹ä¿®æ”¹æ–‡ä»¶ï¼Œç³»ç»Ÿç«‹å³æŠŠå˜åŒ–åŒæ­¥åˆ°å…¶ä»–åœ°æ–¹ã€‚

```
ä¼ ç»ŸåŒæ­¥æ–¹å¼ï¼š
å®šæ—¶æ£€æŸ¥æ–‡ä»¶ â†’ å‘ç°å˜åŒ– â†’ æ‰§è¡ŒåŒæ­¥
é—®é¢˜ï¼šæœ‰å»¶è¿Ÿï¼Œå¯èƒ½é”™è¿‡å¿«é€Ÿå˜åŒ–

å®æ—¶åŒæ­¥æ–¹å¼ï¼š
æ–‡ä»¶å˜åŒ– â†’ ç«‹å³è§¦å‘äº‹ä»¶ â†’ é©¬ä¸Šæ‰§è¡ŒåŒæ­¥
ä¼˜åŠ¿ï¼šæ— å»¶è¿Ÿï¼Œå®æ—¶å“åº”
```

### 1.2 å®æ—¶åŒæ­¥çš„è§¦å‘æœºåˆ¶


**ğŸ”¸ åŸºäºäº‹ä»¶çš„è§¦å‘**
```
æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ï¼š
â”œâ”€â”€ æ–‡ä»¶åˆ›å»º (CREATE)     â†’ æ–°æ–‡ä»¶å‡ºç°
â”œâ”€â”€ æ–‡ä»¶ä¿®æ”¹ (MODIFY)     â†’ å†…å®¹å‘ç”Ÿå˜åŒ–  
â”œâ”€â”€ æ–‡ä»¶åˆ é™¤ (DELETE)     â†’ æ–‡ä»¶è¢«ç§»é™¤
â”œâ”€â”€ æ–‡ä»¶ç§»åŠ¨ (MOVED)      â†’ ä½ç½®æ”¹å˜
â””â”€â”€ å±æ€§å˜åŒ– (ATTRIB)     â†’ æƒé™/æ—¶é—´æˆ³å˜åŒ–
```

**ğŸ’¡ å·¥ä½œåŸç†**
```
ç›‘æ§ç¨‹åº â†’ æ–‡ä»¶ç³»ç»Ÿ â†’ äº‹ä»¶é˜Ÿåˆ— â†’ åŒæ­¥ç¨‹åº

å…·ä½“æµç¨‹ï¼š
1. ç›‘æ§ç¨‹åºç›‘å¬æŒ‡å®šç›®å½•
2. æ–‡ä»¶ç³»ç»Ÿäº§ç”Ÿå˜åŒ–äº‹ä»¶
3. äº‹ä»¶è¿›å…¥é˜Ÿåˆ—ç­‰å¾…å¤„ç†
4. åŒæ­¥ç¨‹åºæ¥æ”¶äº‹ä»¶å¹¶æ‰§è¡Œæ“ä½œ
```

### 1.3 å®æ—¶åŒæ­¥çš„ä¼˜åŠ¿


**âš¡ å“åº”é€Ÿåº¦å¯¹æ¯”**
```
å®šæ—¶åŒæ­¥ï¼šæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
- æœ€å¤§å»¶è¿Ÿï¼š5åˆ†é’Ÿ
- é€‚ç”¨åœºæ™¯ï¼šå¯¹æ—¶æ•ˆæ€§è¦æ±‚ä¸é«˜

å®æ—¶åŒæ­¥ï¼šæ–‡ä»¶å˜åŒ–ç«‹å³å“åº”
- æœ€å¤§å»¶è¿Ÿï¼š1-2ç§’
- é€‚ç”¨åœºæ™¯ï¼šé«˜å®æ—¶æ€§è¦æ±‚
```

---

## 2. ğŸ”§ rsyncç»“åˆinotifyè‡ªåŠ¨åŒæ­¥


### 2.1 rsyncæ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šrsyncå°±åƒ**æ™ºèƒ½å¤åˆ¶å·¥å…·**ï¼Œå®ƒä¸ä¼šå‚»å‚»åœ°æŠŠæ‰€æœ‰æ–‡ä»¶é‡æ–°å¤åˆ¶ä¸€éï¼Œè€Œæ˜¯åªå¤åˆ¶æœ‰å˜åŒ–çš„éƒ¨åˆ†ã€‚

```
æ™®é€šå¤åˆ¶ cpï¼š
æºæ–‡ä»¶(100MB) â†’ ç›®æ ‡æ–‡ä»¶(100MB)
æ¯æ¬¡éƒ½å¤åˆ¶å®Œæ•´çš„100MB

æ™ºèƒ½å¤åˆ¶ rsyncï¼š
æºæ–‡ä»¶(100MB) â†’ åªå¤åˆ¶å˜åŒ–çš„1MB â†’ ç›®æ ‡æ–‡ä»¶
èŠ‚çœ99%çš„ä¼ è¾“é‡
```

### 2.2 inotifyæ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šinotifyå°±åƒ**æ–‡ä»¶ä¿é•–**ï¼Œä¸“é—¨ç›‘è§†æ–‡ä»¶çš„ä¸€ä¸¾ä¸€åŠ¨ï¼Œæœ‰ä»»ä½•å˜åŒ–ç«‹å³æŠ¥å‘Šã€‚

```
ä¼ ç»Ÿç›‘æ§æ–¹å¼ï¼š
æ¯éš”ä¸€æ®µæ—¶é—´å»æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–
å°±åƒå®šæ—¶å·¡é€»ï¼Œå¯èƒ½é”™è¿‡ä¸­é—´å‘ç”Ÿçš„äº‹æƒ…

inotifyæ–¹å¼ï¼š
æ–‡ä»¶ä¸€æœ‰å˜åŒ–å°±ç«‹å³é€šçŸ¥
å°±åƒ24å°æ—¶è´´èº«ä¿é•–ï¼Œä»»ä½•åŠ¨é™éƒ½çŸ¥é“
```

### 2.3 ç»“åˆä½¿ç”¨çš„å®ç°


**ğŸ› ï¸ åŸºç¡€åŒæ­¥è„šæœ¬**
```bash
#!/bin/bash
# æ–‡ä»¶ï¼šauto_sync.sh

# é…ç½®å‚æ•°
SOURCE_DIR="/data/source/"           # æºç›®å½•
TARGET_DIR="/backup/target/"         # ç›®æ ‡ç›®å½•
LOG_FILE="/var/log/sync.log"        # æ—¥å¿—æ–‡ä»¶

# åŒæ­¥å‡½æ•°
sync_files() {
    echo "$(date): å¼€å§‹åŒæ­¥..." >> $LOG_FILE
    
    # rsyncåŒæ­¥å‘½ä»¤
    rsync -av --delete \
          --log-file=$LOG_FILE \
          $SOURCE_DIR $TARGET_DIR
    
    if [ $? -eq 0 ]; then
        echo "$(date): åŒæ­¥æˆåŠŸ" >> $LOG_FILE
    else
        echo "$(date): åŒæ­¥å¤±è´¥" >> $LOG_FILE
    fi
}

# ä½¿ç”¨inotifywaitç›‘æ§
inotifywait -m -r -e modify,create,delete,move \
    --format '%w%f %e' $SOURCE_DIR | \
while read file event; do
    echo "$(date): æ£€æµ‹åˆ°å˜åŒ– $file $event" >> $LOG_FILE
    sync_files
done
```

**ğŸ“Š åŒæ­¥æ•ˆæœå¯¹æ¯”**
| åŒæ­¥æ–¹å¼ | **å“åº”æ—¶é—´** | **èµ„æºæ¶ˆè€—** | **å‡†ç¡®æ€§** |
|---------|-------------|-------------|-----------|
| å®šæ—¶åŒæ­¥ | `5-60åˆ†é’Ÿ` | `ä½` | `å¯èƒ½é—æ¼` |
| å®æ—¶åŒæ­¥ | `1-2ç§’` | `ä¸­ç­‰` | `100%å‡†ç¡®` |

### 2.4 é«˜çº§åŒæ­¥é…ç½®


**ğŸ”§ æ™ºèƒ½åŒæ­¥è„šæœ¬**
```bash
#!/bin/bash
# é«˜çº§åŒæ­¥é…ç½®

# æ’é™¤ä¸éœ€è¦åŒæ­¥çš„æ–‡ä»¶
EXCLUDE_PATTERNS="
--exclude='*.tmp' 
--exclude='*.log' 
--exclude='.git/*'
--exclude='node_modules/*'
"

# å¸¦å»¶è¿Ÿçš„æ‰¹é‡åŒæ­¥
sync_with_delay() {
    sleep 2  # ç­‰å¾…2ç§’ï¼Œé¿å…é¢‘ç¹åŒæ­¥
    
    rsync -av --delete \
          $EXCLUDE_PATTERNS \
          --stats \
          $SOURCE_DIR $TARGET_DIR
}

# ç›‘æ§ç‰¹å®šäº‹ä»¶
inotifywait -m -r \
    -e close_write,moved_to,create,delete \
    --format '%w%f %e %T' --timefmt '%Y-%m-%d %H:%M:%S' \
    $SOURCE_DIR | \
while read file event time; do
    echo "[$time] $event: $file"
    sync_with_delay
done
```

---

## 3. âš™ï¸ é…ç½®æ–‡ä»¶å˜æ›´è‡ªåŠ¨é‡è½½


### 3.1 é…ç½®æ–‡ä»¶è‡ªåŠ¨é‡è½½çš„ä½œç”¨


**å®é™…åœºæ™¯**ï¼šæƒ³è±¡ä½ åœ¨ç®¡ç†ä¸€ä¸ªç½‘ç«™æœåŠ¡å™¨ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥è°ƒæ•´æ€§èƒ½ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
2. æ‰‹åŠ¨é‡å¯æœåŠ¡
3. ç”¨æˆ·è®¿é—®ä¸­æ–­

è‡ªåŠ¨é‡è½½æ–¹å¼ï¼š
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
2. ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å˜åŒ–
3. æœåŠ¡è‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®
4. ç”¨æˆ·æ— æ„ŸçŸ¥æ›´æ–°
```

### 3.2 Nginxé…ç½®è‡ªåŠ¨é‡è½½


**ğŸŒ Nginxé‡è½½ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# nginxé…ç½®ç›‘æ§è„šæœ¬

NGINX_CONF="/etc/nginx/nginx.conf"
NGINX_CONF_DIR="/etc/nginx/conf.d/"

reload_nginx() {
    echo "$(date): æ£€æŸ¥Nginxé…ç½®è¯­æ³•..."
    
    # å…ˆæ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
    nginx -t
    if [ $? -eq 0 ]; then
        echo "$(date): é…ç½®è¯­æ³•æ­£ç¡®ï¼Œé‡æ–°åŠ è½½..."
        systemctl reload nginx
        echo "$(date): Nginxé‡è½½å®Œæˆ"
    else
        echo "$(date): é…ç½®è¯­æ³•é”™è¯¯ï¼Œå–æ¶ˆé‡è½½"
        # å¯ä»¥å‘é€å‘Šè­¦é€šçŸ¥
        echo "Nginxé…ç½®é”™è¯¯" | mail -s "é…ç½®å‘Šè­¦" admin@example.com
    fi
}

# ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ–
inotifywait -m -e close_write \
    $NGINX_CONF $NGINX_CONF_DIR | \
while read path event file; do
    echo "$(date): é…ç½®æ–‡ä»¶å˜åŒ– $path$file"
    reload_nginx
done
```

### 3.3 åº”ç”¨ç¨‹åºé…ç½®ç›‘æ§


**â˜• Javaåº”ç”¨é…ç½®çƒ­é‡è½½**
```bash
#!/bin/bash
# Javaåº”ç”¨é…ç½®ç›‘æ§

APP_CONFIG="/opt/app/config/application.properties"
APP_PID_FILE="/var/run/myapp.pid"

reload_app_config() {
    if [ -f $APP_PID_FILE ]; then
        APP_PID=$(cat $APP_PID_FILE)
        
        # å‘é€USR1ä¿¡å·è§¦å‘é…ç½®é‡è½½
        # (éœ€è¦åº”ç”¨ç¨‹åºæ”¯æŒä¿¡å·å¤„ç†)
        kill -USR1 $APP_PID
        echo "$(date): å·²é€šçŸ¥åº”ç”¨é‡è½½é…ç½®"
    else
        echo "$(date): åº”ç”¨æœªè¿è¡Œï¼Œæ— éœ€é‡è½½"
    fi
}

# ç›‘æ§é…ç½®æ–‡ä»¶
inotifywait -m -e modify $APP_CONFIG | \
while read path event file; do
    echo "$(date): åº”ç”¨é…ç½®å˜åŒ–"
    reload_app_config
done
```

---

## 4. ğŸ“‹ æ—¥å¿—æ–‡ä»¶è½®è½¬ç›‘æ§


### 4.1 ä»€ä¹ˆæ˜¯æ—¥å¿—è½®è½¬


**ç”Ÿæ´»åŒ–æ¯”å–»**ï¼šæ—¥å¿—è½®è½¬å°±åƒ**æ¢æ—¥è®°æœ¬**ã€‚å½“ä¸€æœ¬æ—¥è®°å†™æ»¡äº†ï¼Œå°±æ¢æ–°æœ¬ç»§ç»­å†™ï¼Œæ—§æœ¬å­˜æ¡£ä¿å­˜ã€‚

```
æ²¡æœ‰è½®è½¬çš„é—®é¢˜ï¼š
æ—¥å¿—æ–‡ä»¶è¶Šæ¥è¶Šå¤§ â†’ å æ»¡ç£ç›˜ç©ºé—´ â†’ ç³»ç»Ÿå´©æºƒ

æœ‰è½®è½¬çš„å¥½å¤„ï¼š
- æ§åˆ¶å•ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°
- ä¿ç•™å†å²æ—¥å¿—è®°å½•
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ—¥å¿—
- èŠ‚çœå­˜å‚¨ç©ºé—´
```

### 4.2 æ—¥å¿—è½®è½¬äº‹ä»¶ç›‘æ§


**ğŸ“Š æ—¥å¿—è½®è½¬ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# æ—¥å¿—è½®è½¬ç›‘æ§è„šæœ¬

LOG_DIR="/var/log"
BACKUP_DIR="/backup/logs"

# å¤„ç†æ—¥å¿—è½®è½¬äº‹ä»¶
handle_log_rotation() {
    local log_file=$1
    local event=$2
    
    case $event in
        "moved_to"|"create")
            if [[ $log_file == *.gz || $log_file == *.[0-9] ]]; then
                echo "$(date): æ£€æµ‹åˆ°æ—¥å¿—è½®è½¬æ–‡ä»¶: $log_file"
                
                # å¤‡ä»½è½®è½¬åçš„æ—¥å¿—
                cp "$LOG_DIR/$log_file" "$BACKUP_DIR/"
                
                # å‹ç¼©æœªå‹ç¼©çš„è½®è½¬æ—¥å¿—
                if [[ $log_file != *.gz ]]; then
                    gzip "$BACKUP_DIR/$log_file"
                fi
                
                echo "$(date): æ—¥å¿—å¤‡ä»½å®Œæˆ: $log_file"
            fi
            ;;
        "delete")
            echo "$(date): æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤: $log_file"
            ;;
    esac
}

# ç›‘æ§æ—¥å¿—ç›®å½•
inotifywait -m -r -e create,moved_to,delete \
    --format '%f %e' $LOG_DIR | \
while read file event; do
    handle_log_rotation "$file" "$event"
done
```

### 4.3 ç³»ç»Ÿæ—¥å¿—æ¸…ç†è‡ªåŠ¨åŒ–


**ğŸ§¹ è‡ªåŠ¨æ¸…ç†è„šæœ¬**
```bash
#!/bin/bash
# æ—¥å¿—æ¸…ç†è‡ªåŠ¨åŒ–

cleanup_old_logs() {
    local log_path=$1
    
    echo "$(date): å¼€å§‹æ¸…ç†è¿‡æœŸæ—¥å¿—..."
    
    # åˆ é™¤7å¤©å‰çš„æ—¥å¿—æ–‡ä»¶
    find $BACKUP_DIR -name "*.gz" -mtime +7 -delete
    
    # åˆ é™¤30å¤©å‰çš„è½®è½¬æ—¥å¿—
    find $LOG_DIR -name "*.log.[0-9]*" -mtime +30 -delete
    
    echo "$(date): æ—¥å¿—æ¸…ç†å®Œæˆ"
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    disk_usage=$(df $LOG_DIR | awk 'NR==2{print $5}' | sed 's/%//')
    if [ $disk_usage -gt 80 ]; then
        echo "è­¦å‘Šï¼šæ—¥å¿—ç£ç›˜ä½¿ç”¨ç‡ ${disk_usage}%" | \
        mail -s "ç£ç›˜ç©ºé—´å‘Šè­¦" admin@example.com
    fi
}

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡æ¸…ç†æ£€æŸ¥
while true; do
    sleep 3600  # 1å°æ—¶
    cleanup_old_logs
done &

# ç›‘æ§æ—¥å¿—è½®è½¬è§¦å‘æ¸…ç†
inotifywait -m -e moved_to $LOG_DIR | \
while read path event file; do
    if [[ $file == *.log.1 ]]; then
        echo "$(date): æ£€æµ‹åˆ°æ—¥å¿—è½®è½¬ï¼Œæ‰§è¡Œæ¸…ç†"
        cleanup_old_logs
    fi
done
```

---

## 5. ğŸŒ Webåº”ç”¨çƒ­éƒ¨ç½²è§¦å‘


### 5.1 ä»€ä¹ˆæ˜¯çƒ­éƒ¨ç½²


**é€šä¿—ç†è§£**ï¼šçƒ­éƒ¨ç½²å°±åƒ**ä¸åœè½¦æ¢è½®èƒ**ï¼Œåœ¨åº”ç”¨è¿è¡Œæ—¶æ›´æ–°ä»£ç ï¼Œç”¨æˆ·å®Œå…¨æ„Ÿè§‰ä¸åˆ°ä¸­æ–­ã€‚

```
ä¼ ç»Ÿéƒ¨ç½²ï¼š
åœæ­¢åº”ç”¨ â†’ æ›´æ–°ä»£ç  â†’ é‡å¯åº”ç”¨
ç”¨æˆ·ä½“éªŒï¼šè®¿é—®ä¸­æ–­ï¼Œç­‰å¾…é‡å¯

çƒ­éƒ¨ç½²ï¼š
æ£€æµ‹ä»£ç å˜åŒ– â†’ è‡ªåŠ¨æ›´æ–° â†’ æ— ç¼åˆ‡æ¢
ç”¨æˆ·ä½“éªŒï¼šæ— æ„ŸçŸ¥æ›´æ–°ï¼ŒæŒç»­å¯ç”¨
```

### 5.2 Webåº”ç”¨éƒ¨ç½²ç›‘æ§


**ğŸš€ è‡ªåŠ¨éƒ¨ç½²è„šæœ¬**
```bash
#!/bin/bash
# Webåº”ç”¨çƒ­éƒ¨ç½²è„šæœ¬

DEPLOY_DIR="/var/www/html"
STAGING_DIR="/tmp/deploy"
BACKUP_DIR="/backup/web"

# éƒ¨ç½²æ–°ç‰ˆæœ¬
deploy_application() {
    local changed_file=$1
    
    echo "$(date): å¼€å§‹éƒ¨ç½²åº”ç”¨..."
    
    # åˆ›å»ºå¤‡ä»½
    timestamp=$(date +%Y%m%d_%H%M%S)
    backup_path="$BACKUP_DIR/backup_$timestamp"
    
    cp -r $DEPLOY_DIR $backup_path
    echo "$(date): åˆ›å»ºå¤‡ä»½è‡³ $backup_path"
    
    # éƒ¨ç½²æ–°æ–‡ä»¶
    if [[ $changed_file == *.php || $changed_file == *.html || $changed_file == *.js ]]; then
        # Webæ–‡ä»¶ç›´æ¥å¤åˆ¶
        cp "$STAGING_DIR/$changed_file" "$DEPLOY_DIR/"
        echo "$(date): éƒ¨ç½²æ–‡ä»¶ $changed_file"
        
        # æ¸…ç†ç¼“å­˜
        if [ -d "/tmp/app_cache" ]; then
            rm -rf /tmp/app_cache/*
            echo "$(date): æ¸…ç†åº”ç”¨ç¼“å­˜"
        fi
    fi
    
    # éªŒè¯éƒ¨ç½²
    if curl -s -o /dev/null -w "%{http_code}" http://localhost | grep -q "200"; then
        echo "$(date): éƒ¨ç½²æˆåŠŸï¼Œåº”ç”¨æ­£å¸¸è¿è¡Œ"
    else
        echo "$(date): éƒ¨ç½²å¤±è´¥ï¼Œå¼€å§‹å›æ»š..."
        cp -r $backup_path/* $DEPLOY_DIR/
        echo "$(date): å›æ»šå®Œæˆ"
    fi
}

# ç›‘æ§éƒ¨ç½²ç›®å½•
inotifywait -m -r -e close_write,moved_to \
    --format '%f %e' $STAGING_DIR | \
while read file event; do
    echo "$(date): æ£€æµ‹åˆ°éƒ¨ç½²æ–‡ä»¶å˜åŒ–: $file"
    deploy_application "$file"
done
```

### 5.3 Dockerå®¹å™¨çƒ­æ›´æ–°


**ğŸ³ å®¹å™¨çƒ­æ›´æ–°è„šæœ¬**
```bash
#!/bin/bash
# Dockeråº”ç”¨çƒ­æ›´æ–°

IMAGE_NAME="myapp"
CONTAINER_NAME="myapp-prod"
DOCKERFILE_PATH="/opt/docker"

# å®¹å™¨çƒ­æ›´æ–°å‡½æ•°
hot_update_container() {
    echo "$(date): å¼€å§‹å®¹å™¨çƒ­æ›´æ–°..."
    
    # æ„å»ºæ–°é•œåƒ
    cd $DOCKERFILE_PATH
    docker build -t $IMAGE_NAME:latest .
    
    if [ $? -eq 0 ]; then
        echo "$(date): é•œåƒæ„å»ºæˆåŠŸ"
        
        # è·å–å½“å‰å®¹å™¨ID
        old_container=$(docker ps -q --filter name=$CONTAINER_NAME)
        
        # å¯åŠ¨æ–°å®¹å™¨
        docker run -d --name ${CONTAINER_NAME}-new \
            -p 8080:8080 $IMAGE_NAME:latest
        
        # ç­‰å¾…æ–°å®¹å™¨å¯åŠ¨
        sleep 10
        
        # æ£€æŸ¥æ–°å®¹å™¨å¥åº·çŠ¶æ€
        if curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/health | grep -q "200"; then
            echo "$(date): æ–°å®¹å™¨å¯åŠ¨æˆåŠŸï¼Œåˆ‡æ¢æµé‡"
            
            # åœæ­¢æ—§å®¹å™¨
            docker stop $old_container
            docker rm $old_container
            
            # é‡å‘½åæ–°å®¹å™¨
            docker rename ${CONTAINER_NAME}-new $CONTAINER_NAME
            
            echo "$(date): çƒ­æ›´æ–°å®Œæˆ"
        else
            echo "$(date): æ–°å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œæ¸…ç†èµ„æº"
            docker stop ${CONTAINER_NAME}-new
            docker rm ${CONTAINER_NAME}-new
        fi
    fi
}

# ç›‘æ§Dockerfileå’Œä»£ç å˜åŒ–
inotifywait -m -r -e close_write \
    --format '%w%f %e' $DOCKERFILE_PATH | \
while read file event; do
    if [[ $file == */Dockerfile || $file == */src/* ]]; then
        echo "$(date): æ£€æµ‹åˆ°åº”ç”¨ä»£ç å˜åŒ–"
        hot_update_container
    fi
done
```

---

## 6. ğŸ’¾ æ•°æ®åº“å¤‡ä»½è‡ªåŠ¨è§¦å‘


### 6.1 æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½çš„é‡è¦æ€§


**é£é™©åœºæ™¯**ï¼š
```
æ•°æ®ä¸¢å¤±åœºæ™¯ï¼š
- ç¡¬ä»¶æ•…éšœå¯¼è‡´æ•°æ®æŸå
- äººä¸ºè¯¯æ“ä½œåˆ é™¤æ•°æ®
- é»‘å®¢æ”»å‡»ç ´åæ•°æ®
- ç³»ç»Ÿå‡çº§å¤±è´¥

è‡ªåŠ¨å¤‡ä»½çš„ä»·å€¼ï¼š
- å®šæœŸä¿å­˜æ•°æ®å¿«ç…§
- æ£€æµ‹åˆ°å…³é”®å˜åŒ–ç«‹å³å¤‡ä»½
- å¤šç‰ˆæœ¬å¤‡ä»½ä¿è¯æ•°æ®å®‰å…¨
- å¿«é€Ÿæ¢å¤ä¸šåŠ¡è¿ç»­æ€§
```

### 6.2 MySQLè‡ªåŠ¨å¤‡ä»½è§¦å‘


**ğŸ—„ï¸ MySQLå¤‡ä»½ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# MySQLè‡ªåŠ¨å¤‡ä»½è„šæœ¬

DB_NAME="myapp"
DB_USER="backup_user"
DB_PASS="backup_password"
BACKUP_DIR="/backup/mysql"
LOG_DIR="/var/log/mysql"

# æ‰§è¡Œæ•°æ®åº“å¤‡ä»½
perform_backup() {
    local trigger_reason=$1
    
    echo "$(date): å¼€å§‹æ•°æ®åº“å¤‡ä»½ï¼Œè§¦å‘åŸå› ï¼š$trigger_reason"
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    backup_date=$(date +%Y%m%d_%H%M%S)
    backup_path="$BACKUP_DIR/${DB_NAME}_${backup_date}.sql"
    
    # æ‰§è¡Œå¤‡ä»½
    mysqldump -u$DB_USER -p$DB_PASS \
        --single-transaction \
        --routines \
        --triggers \
        $DB_NAME > $backup_path
    
    if [ $? -eq 0 ]; then
        # å‹ç¼©å¤‡ä»½æ–‡ä»¶
        gzip $backup_path
        echo "$(date): å¤‡ä»½å®Œæˆï¼š${backup_path}.gz"
        
        # æ¸…ç†è€å¤‡ä»½ï¼ˆä¿ç•™7å¤©ï¼‰
        find $BACKUP_DIR -name "${DB_NAME}_*.sql.gz" -mtime +7 -delete
        
        # éªŒè¯å¤‡ä»½å®Œæ•´æ€§
        if zcat ${backup_path}.gz | head -10 | grep -q "MySQL dump"; then
            echo "$(date): å¤‡ä»½æ–‡ä»¶éªŒè¯é€šè¿‡"
        else
            echo "$(date): è­¦å‘Šï¼šå¤‡ä»½æ–‡ä»¶å¯èƒ½æŸå"
        fi
    else
        echo "$(date): å¤‡ä»½å¤±è´¥"
    fi
}

# ç›‘æ§å…³é”®æ•°æ®ç›®å½•å˜åŒ–
DATA_DIR="/var/lib/mysql/$DB_NAME"

inotifywait -m -r -e close_write,create \
    --format '%w%f %e' $DATA_DIR | \
while read file event; do
    # è¿‡æ»¤é‡è¦è¡¨æ–‡ä»¶å˜åŒ–
    if [[ $file == *.frm || $file == *.ibd ]]; then
        echo "$(date): æ£€æµ‹åˆ°æ•°æ®è¡¨å˜åŒ–ï¼š$file"
        perform_backup "æ•°æ®è¡¨ç»“æ„å˜åŒ–"
    fi
done &

# å®šæ—¶å¤‡ä»½ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
while true; do
    current_hour=$(date +%H)
    current_minute=$(date +%M)
    
    if [[ $current_hour == "02" && $current_minute == "00" ]]; then
        perform_backup "å®šæ—¶å¤‡ä»½"
        sleep 60  # é¿å…é‡å¤æ‰§è¡Œ
    fi
    
    sleep 60
done
```

### 6.3 æ•°æ®åº“æ—¥å¿—ç›‘æ§å¤‡ä»½


**ğŸ“ˆ åŸºäºæ—¥å¿—çš„å¢é‡å¤‡ä»½**
```bash
#!/bin/bash
# MySQL binlogç›‘æ§å¤‡ä»½

MYSQL_LOG_DIR="/var/log/mysql"
BINLOG_BACKUP_DIR="/backup/binlog"

# å¤„ç†binlogè½®è½¬
handle_binlog_rotation() {
    local binlog_file=$1
    
    echo "$(date): å¤„ç†binlogæ–‡ä»¶ï¼š$binlog_file"
    
    # å¤‡ä»½binlogæ–‡ä»¶
    if [[ $binlog_file == mysql-bin.* ]]; then
        cp "$MYSQL_LOG_DIR/$binlog_file" "$BINLOG_BACKUP_DIR/"
        
        # éªŒè¯binlogå®Œæ•´æ€§
        mysqlbinlog --verify-binlog-checksum "$BINLOG_BACKUP_DIR/$binlog_file" > /dev/null
        
        if [ $? -eq 0 ]; then
            echo "$(date): binlogå¤‡ä»½å®Œæˆï¼š$binlog_file"
            
            # å‹ç¼©å¤‡ä»½
            gzip "$BINLOG_BACKUP_DIR/$binlog_file"
        else
            echo "$(date): binlogæ–‡ä»¶æŸåï¼š$binlog_file"
            rm -f "$BINLOG_BACKUP_DIR/$binlog_file"
        fi
    fi
}

# ç›‘æ§binlogç›®å½•
inotifywait -m -e moved_to,create \
    --format '%f %e' $MYSQL_LOG_DIR | \
while read file event; do
    handle_binlog_rotation "$file"
done
```

---

## 7. ğŸ“¤ æ–‡ä»¶ä¸Šä¼ å®Œæˆæ£€æµ‹


### 7.1 æ–‡ä»¶ä¸Šä¼ å®Œæˆæ£€æµ‹çš„éœ€æ±‚


**å®é™…åœºæ™¯**ï¼šç½‘ç«™ç”¨æˆ·ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œç³»ç»Ÿéœ€è¦çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¸Šä¼ çœŸæ­£å®Œæˆã€‚

```
é—®é¢˜åœºæ™¯ï¼š
ç”¨æˆ·ä¸Šä¼ 100MBè§†é¢‘æ–‡ä»¶
- ä¸Šä¼ è¿‡ç¨‹ä¸­ï¼šæ–‡ä»¶å¤§å°ä¸æ–­å˜åŒ–
- ç³»ç»Ÿè¯¯åˆ¤ï¼šä»¥ä¸ºæ–‡ä»¶å·²å®Œæˆï¼Œå¼€å§‹å¤„ç†
- ç»“æœï¼šå¤„ç†ä¸å®Œæ•´æ–‡ä»¶ï¼Œäº§ç”Ÿé”™è¯¯

è§£å†³æ–¹æ¡ˆï¼š
- æ£€æµ‹æ–‡ä»¶åœæ­¢å˜åŒ–
- ç¡®è®¤ä¸Šä¼ çœŸæ­£å®Œæˆ
- å†å¼€å§‹åç»­å¤„ç†
```

### 7.2 ä¸Šä¼ å®Œæˆæ£€æµ‹æœºåˆ¶


**ğŸ“ æ–‡ä»¶ä¸Šä¼ ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# æ–‡ä»¶ä¸Šä¼ å®Œæˆæ£€æµ‹è„šæœ¬

UPLOAD_DIR="/var/www/uploads"
PROCESS_DIR="/var/www/processing"
COMPLETE_DIR="/var/www/completed"

# æ–‡ä»¶å®Œæˆæ£€æµ‹å‡½æ•°
check_upload_complete() {
    local file_path=$1
    local file_name=$(basename "$file_path")
    
    echo "$(date): æ£€æµ‹ä¸Šä¼ æ–‡ä»¶ï¼š$file_name"
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¿˜åœ¨å†™å…¥
    local initial_size=$(stat -c%s "$file_path" 2>/dev/null || echo 0)
    sleep 2  # ç­‰å¾…2ç§’
    local final_size=$(stat -c%s "$file_path" 2>/dev/null || echo 0)
    
    if [ "$initial_size" -eq "$final_size" ] && [ "$final_size" -gt 0 ]; then
        echo "$(date): æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼š$file_name (${final_size} bytes)"
        
        # ç§»åŠ¨åˆ°å¤„ç†ç›®å½•
        mv "$file_path" "$PROCESS_DIR/"
        
        # è§¦å‘åç»­å¤„ç†
        process_uploaded_file "$PROCESS_DIR/$file_name"
    else
        echo "$(date): æ–‡ä»¶è¿˜åœ¨ä¸Šä¼ ä¸­ï¼š$file_name ($initial_size -> $final_size bytes)"
    fi
}

# æ–‡ä»¶å¤„ç†å‡½æ•°
process_uploaded_file() {
    local file_path=$1
    local file_name=$(basename "$file_path")
    
    echo "$(date): å¼€å§‹å¤„ç†æ–‡ä»¶ï¼š$file_name"
    
    # æ£€æŸ¥æ–‡ä»¶ç±»å‹
    file_type=$(file -b --mime-type "$file_path")
    
    case $file_type in
        image/*)
            echo "$(date): å¤„ç†å›¾ç‰‡æ–‡ä»¶ï¼š$file_name"
            # ç”Ÿæˆç¼©ç•¥å›¾
            convert "$file_path" -resize 200x200 "${file_path%.*}_thumb.jpg"
            ;;
        video/*)
            echo "$(date): å¤„ç†è§†é¢‘æ–‡ä»¶ï¼š$file_name"
            # ç”Ÿæˆé¢„è§ˆæˆªå›¾
            ffmpeg -i "$file_path" -ss 00:00:01 -frames:v 1 "${file_path%.*}_preview.jpg"
            ;;
        application/pdf)
            echo "$(date): å¤„ç†PDFæ–‡ä»¶ï¼š$file_name"
            # æå–æ–‡æœ¬å†…å®¹
            pdftotext "$file_path" "${file_path%.*}.txt"
            ;;
    esac
    
    # ç§»åŠ¨åˆ°å®Œæˆç›®å½•
    mv "$file_path" "$COMPLETE_DIR/"
    echo "$(date): æ–‡ä»¶å¤„ç†å®Œæˆï¼š$file_name"
}

# ç›‘æ§ä¸Šä¼ ç›®å½•
inotifywait -m -e close_write,moved_to \
    --format '%w%f' $UPLOAD_DIR | \
while read file_path; do
    # å»¶è¿Ÿæ£€æµ‹ï¼Œç¡®ä¿æ–‡ä»¶å†™å…¥å®Œæˆ
    sleep 1
    check_upload_complete "$file_path"
done
```

### 7.3 å¤§æ–‡ä»¶ä¸Šä¼ è¿›åº¦ç›‘æ§


**ğŸ“Š ä¸Šä¼ è¿›åº¦è¿½è¸ª**
```bash
#!/bin/bash
# å¤§æ–‡ä»¶ä¸Šä¼ è¿›åº¦ç›‘æ§

UPLOAD_TEMP_DIR="/tmp/uploads"
UPLOAD_LOG="/var/log/upload.log"

# ç›‘æ§ä¸Šä¼ è¿›åº¦
track_upload_progress() {
    local temp_file=$1
    local file_name=$(basename "$temp_file")
    
    echo "$(date): å¼€å§‹ç›‘æ§ä¸Šä¼ ï¼š$file_name" >> $UPLOAD_LOG
    
    local last_size=0
    local stable_count=0
    
    while [ -f "$temp_file" ]; do
        current_size=$(stat -c%s "$temp_file" 2>/dev/null || echo 0)
        
        if [ "$current_size" -eq "$last_size" ]; then
            stable_count=$((stable_count + 1))
            
            # å¤§å°è¿ç»­3æ¬¡æ£€æŸ¥æ²¡å˜åŒ–ï¼Œè®¤ä¸ºä¸Šä¼ å®Œæˆ
            if [ $stable_count -ge 3 ]; then
                echo "$(date): ä¸Šä¼ å®Œæˆï¼š$file_name (${current_size} bytes)" >> $UPLOAD_LOG
                
                # ç§»åŠ¨åˆ°æ­£å¼ä¸Šä¼ ç›®å½•
                final_name="${file_name%.tmp}"
                mv "$temp_file" "$UPLOAD_DIR/$final_name"
                
                break
            fi
        else
            stable_count=0
            progress=$((current_size - last_size))
            echo "$(date): ä¸Šä¼ è¿›åº¦ï¼š$file_name (+${progress} bytes, æ€»è®¡ ${current_size})" >> $UPLOAD_LOG
        fi
        
        last_size=$current_size
        sleep 2
    done
}

# ç›‘æ§ä¸´æ—¶ä¸Šä¼ ç›®å½•
inotifywait -m -e create \
    --format '%w%f' $UPLOAD_TEMP_DIR | \
while read temp_file; do
    # åªå¤„ç†.tmpæ–‡ä»¶
    if [[ $temp_file == *.tmp ]]; then
        track_upload_progress "$temp_file" &
    fi
done
```

---

## 8. âš™ï¸ æ‰¹å¤„ç†ä»»åŠ¡è‡ªåŠ¨å¯åŠ¨


### 8.1 æ‰¹å¤„ç†ä»»åŠ¡çš„è§¦å‘åœºæ™¯


**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```
æ•°æ®å¤„ç†åœºæ™¯ï¼š
- æ¯å¤©æ”¶åˆ°å®¢æˆ·æ•°æ®æ–‡ä»¶
- éœ€è¦è‡ªåŠ¨å¯¼å…¥æ•°æ®åº“
- ç”ŸæˆæŠ¥è¡¨å¹¶å‘é€é‚®ä»¶

ä¼ ç»Ÿæ–¹å¼ï¼š
å®šæ—¶ä»»åŠ¡ â†’ ä¸çµæ´»ï¼Œå¯èƒ½ç©ºè·‘æˆ–é—æ¼

äº‹ä»¶é©±åŠ¨æ–¹å¼ï¼š
æ–‡ä»¶åˆ°è¾¾ â†’ ç«‹å³å¤„ç† â†’ é«˜æ•ˆå‡†ç¡®
```

### 8.2 æ•°æ®æ–‡ä»¶å¤„ç†è‡ªåŠ¨åŒ–


**ğŸ“‹ æ•°æ®å¤„ç†è‡ªåŠ¨åŒ–è„šæœ¬**
```bash
#!/bin/bash
# æ‰¹å¤„ç†ä»»åŠ¡è‡ªåŠ¨å¯åŠ¨è„šæœ¬

DATA_INPUT_DIR="/data/input"
DATA_PROCESSING_DIR="/data/processing" 
DATA_OUTPUT_DIR="/data/output"
DATA_ERROR_DIR="/data/error"

# æ•°æ®å¤„ç†å‡½æ•°
process_data_file() {
    local input_file=$1
    local file_name=$(basename "$input_file")
    local base_name="${file_name%.*}"
    
    echo "$(date): å¼€å§‹å¤„ç†æ•°æ®æ–‡ä»¶ï¼š$file_name"
    
    # ç§»åŠ¨æ–‡ä»¶åˆ°å¤„ç†ç›®å½•
    mv "$input_file" "$DATA_PROCESSING_DIR/"
    processing_file="$DATA_PROCESSING_DIR/$file_name"
    
    # éªŒè¯æ–‡ä»¶æ ¼å¼
    if validate_data_format "$processing_file"; then
        echo "$(date): æ–‡ä»¶æ ¼å¼éªŒè¯é€šè¿‡ï¼š$file_name"
        
        # æ‰§è¡Œæ•°æ®å¤„ç†
        case "${file_name##*.}" in
            csv)
                process_csv_file "$processing_file" "$base_name"
                ;;
            xml)
                process_xml_file "$processing_file" "$base_name"
                ;;
            json)
                process_json_file "$processing_file" "$base_name"
                ;;
            *)
                echo "$(date): ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š$file_name"
                mv "$processing_file" "$DATA_ERROR_DIR/"
                return 1
                ;;
        esac
        
        # ç”Ÿæˆå¤„ç†æŠ¥å‘Š
        generate_process_report "$base_name"
        
    else
        echo "$(date): æ–‡ä»¶æ ¼å¼éªŒè¯å¤±è´¥ï¼š$file_name"
        mv "$processing_file" "$DATA_ERROR_DIR/"
    fi
}

# CSVæ–‡ä»¶å¤„ç†
process_csv_file() {
    local csv_file=$1
    local base_name=$2
    
    echo "$(date): å¤„ç†CSVæ–‡ä»¶..."
    
    # æ•°æ®æ¸…æ´—å’Œè½¬æ¢
    python3 << EOF
import pandas as pd
import sys

try:
    # è¯»å–CSVæ–‡ä»¶
    df = pd.read_csv('$csv_file')
    
    # æ•°æ®æ¸…æ´—
    df = df.dropna()  # åˆ é™¤ç©ºå€¼
    df = df.drop_duplicates()  # åˆ é™¤é‡å¤è¡Œ
    
    # æ•°æ®è½¬æ¢å¤„ç†
    # è¿™é‡Œæ·»åŠ å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
    
    # ä¿å­˜å¤„ç†ç»“æœ
    df.to_csv('$DATA_OUTPUT_DIR/${base_name}_processed.csv', index=False)
    print("CSVå¤„ç†å®Œæˆ")
    
except Exception as e:
    print(f"CSVå¤„ç†é”™è¯¯: {e}")
    sys.exit(1)
EOF
    
    if [ $? -eq 0 ]; then
        echo "$(date): CSVå¤„ç†æˆåŠŸï¼š$base_name"
        # å¯¼å…¥æ•°æ®åº“
        import_to_database "$DATA_OUTPUT_DIR/${base_name}_processed.csv"
    else
        echo "$(date): CSVå¤„ç†å¤±è´¥ï¼š$base_name"
        mv "$csv_file" "$DATA_ERROR_DIR/"
    fi
}

# æ•°æ®åº“å¯¼å…¥
import_to_database() {
    local csv_file=$1
    
    mysql -u$DB_USER -p$DB_PASS $DB_NAME << EOF
LOAD DATA LOCAL INFILE '$csv_file'
INTO TABLE processed_data
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;
EOF
    
    if [ $? -eq 0 ]; then
        echo "$(date): æ•°æ®å¯¼å…¥æˆåŠŸ"
    else
        echo "$(date): æ•°æ®å¯¼å…¥å¤±è´¥"
    fi
}

# ç›‘æ§æ•°æ®è¾“å…¥ç›®å½•
inotifywait -m -e close_write,moved_to \
    --format '%w%f' $DATA_INPUT_DIR | \
while read input_file; do
    # ç¡®ä¿æ˜¯æ•°æ®æ–‡ä»¶
    if [[ $input_file == *.csv || $input_file == *.xml || $input_file == *.json ]]; then
        echo "$(date): æ£€æµ‹åˆ°æ–°æ•°æ®æ–‡ä»¶ï¼š$(basename "$input_file")"
        process_data_file "$input_file" &
    fi
done
```

### 8.3 ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†


**ğŸ”„ ä»»åŠ¡é˜Ÿåˆ—å¤„ç†è„šæœ¬**
```bash
#!/bin/bash
# æ‰¹å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†

TASK_QUEUE_DIR="/var/spool/batch_tasks"
MAX_CONCURRENT_JOBS=3
RUNNING_JOBS=0

# ä»»åŠ¡æ‰§è¡Œå‡½æ•°
execute_batch_task() {
    local task_file=$1
    local task_name=$(basename "$task_file" .task)
    
    echo "$(date): å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼š$task_name"
    
    # è¯»å–ä»»åŠ¡é…ç½®
    source "$task_file"
    
    # è®¾ç½®ä»»åŠ¡ç¯å¢ƒ
    export TASK_NAME="$task_name"
    export TASK_START_TIME=$(date +%s)
    
    # æ‰§è¡Œä»»åŠ¡è„šæœ¬
    if [ -n "$TASK_SCRIPT" ] && [ -f "$TASK_SCRIPT" ]; then
        bash "$TASK_SCRIPT"
        task_status=$?
    else
        echo "$(date): ä»»åŠ¡è„šæœ¬ä¸å­˜åœ¨ï¼š$TASK_SCRIPT"
        task_status=1
    fi
    
    # è®°å½•ä»»åŠ¡ç»“æœ
    task_end_time=$(date +%s)
    task_duration=$((task_end_time - TASK_START_TIME))
    
    if [ $task_status -eq 0 ]; then
        echo "$(date): ä»»åŠ¡å®Œæˆï¼š$task_name (è€—æ—¶ï¼š${task_duration}ç§’)"
        mv "$task_file" "$TASK_QUEUE_DIR/completed/"
    else
        echo "$(date): ä»»åŠ¡å¤±è´¥ï¼š$task_name (è€—æ—¶ï¼š${task_duration}ç§’)"
        mv "$task_file" "$TASK_QUEUE_DIR/failed/"
    fi
    
    # å‡å°‘è¿è¡Œä»»åŠ¡è®¡æ•°
    RUNNING_JOBS=$((RUNNING_JOBS - 1))
}

# ä»»åŠ¡è°ƒåº¦å¾ªç¯
schedule_tasks() {
    while true; do
        # æ£€æŸ¥æ˜¯å¦æœ‰å¾…æ‰§è¡Œä»»åŠ¡
        for task_file in "$TASK_QUEUE_DIR"/*.task; do
            [ -f "$task_file" ] || continue
            
            # æ£€æŸ¥å¹¶å‘ä»»åŠ¡æ•°é‡é™åˆ¶
            if [ $RUNNING_JOBS -lt $MAX_CONCURRENT_JOBS ]; then
                echo "$(date): è°ƒåº¦æ–°ä»»åŠ¡ï¼š$(basename "$task_file")"
                
                # åå°æ‰§è¡Œä»»åŠ¡
                execute_batch_task "$task_file" &
                RUNNING_JOBS=$((RUNNING_JOBS + 1))
            else
                echo "$(date): è¾¾åˆ°æœ€å¤§å¹¶å‘æ•°ï¼Œç­‰å¾…ä»»åŠ¡å®Œæˆ"
                break
            fi
        done
        
        sleep 5
    done
}

# ç›‘æ§ä»»åŠ¡é˜Ÿåˆ—ç›®å½•
inotifywait -m -e moved_to,create \
    --format '%f' $TASK_QUEUE_DIR | \
while read task_file; do
    if [[ $task_file == *.task ]]; then
        echo "$(date): æ£€æµ‹åˆ°æ–°ä»»åŠ¡ï¼š$task_file"
    fi
done &

# å¯åŠ¨ä»»åŠ¡è°ƒåº¦å™¨
schedule_tasks
```

---

## 9. ğŸ”— å·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–é›†æˆ


### 9.1 å·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–çš„ä»·å€¼


**ä¸šåŠ¡åœºæ™¯**ï¼šå®Œæ•´çš„ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–
```
ä¼ ç»Ÿæ‰‹å·¥æµç¨‹ï¼š
æ–‡ä»¶ä¸Šä¼  â†’ äººå·¥æ£€æŸ¥ â†’ æ‰‹åŠ¨å¤„ç† â†’ äººå·¥å‘é€ â†’ æ‰‹åŠ¨å½’æ¡£

è‡ªåŠ¨åŒ–æµç¨‹ï¼š
æ–‡ä»¶ä¸Šä¼  â†’ è‡ªåŠ¨æ£€æµ‹ â†’ è‡ªåŠ¨å¤„ç† â†’ è‡ªåŠ¨å‘é€ â†’ è‡ªåŠ¨å½’æ¡£
èŠ‚çœæ—¶é—´ï¼š95%+
å‡å°‘é”™è¯¯ï¼š99%+
æå‡æ•ˆç‡ï¼š10å€+
```

### 9.2 å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹


**ğŸ”„ ç«¯åˆ°ç«¯å·¥ä½œæµç¨‹è„šæœ¬**
```bash
#!/bin/bash
# å®Œæ•´å·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–è„šæœ¬

# å·¥ä½œæµç¨‹é…ç½®
WORKFLOW_CONFIG="/etc/workflow/config.conf"
WORKFLOW_LOG="/var/log/workflow.log"

# åŠ è½½é…ç½®
source $WORKFLOW_CONFIG

# å·¥ä½œæµç¨‹çŠ¶æ€ç®¡ç†
WORKFLOW_STATE_DIR="/var/lib/workflow/state"

# å·¥ä½œæµç¨‹æ­¥éª¤å®šä¹‰
execute_workflow_step() {
    local step_name=$1
    local input_data=$2
    local workflow_id=$3
    
    echo "$(date): [$workflow_id] æ‰§è¡Œæ­¥éª¤ï¼š$step_name" >> $WORKFLOW_LOG
    
    case $step_name in
        "validate_input")
            validate_input_data "$input_data" "$workflow_id"
            ;;
        "process_data")
            process_workflow_data "$input_data" "$workflow_id"
            ;;
        "generate_report")
            generate_workflow_report "$input_data" "$workflow_id"
            ;;
        "send_notification")
            send_workflow_notification "$input_data" "$workflow_id"
            ;;
        "archive_data")
            archive_workflow_data "$input_data" "$workflow_id"
            ;;
        *)
            echo "$(date): [$workflow_id] æœªçŸ¥æ­¥éª¤ï¼š$step_name" >> $WORKFLOW_LOG
            return 1
            ;;
    esac
}

# æ•°æ®éªŒè¯æ­¥éª¤
validate_input_data() {
    local data_file=$1
    local workflow_id=$2
    
    echo "$(date): [$workflow_id] å¼€å§‹æ•°æ®éªŒè¯..." >> $WORKFLOW_LOG
    
    # æ£€æŸ¥æ–‡ä»¶å¤§å°
    file_size=$(stat -c%s "$data_file")
    if [ $file_size -gt $MAX_FILE_SIZE ]; then
        echo "$(date): [$workflow_id] æ–‡ä»¶è¿‡å¤§ï¼š${file_size} > ${MAX_FILE_SIZE}" >> $WORKFLOW_LOG
        return 1
    fi
    
    # æ£€æŸ¥æ–‡ä»¶æ ¼å¼
    if ! validate_file_format "$data_file"; then
        echo "$(date): [$workflow_id] æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®" >> $WORKFLOW_LOG
        return 1
    fi
    
    # æ›´æ–°å·¥ä½œæµçŠ¶æ€
    echo "validated" > "$WORKFLOW_STATE_DIR/${workflow_id}.state"
    
    echo "$(date): [$workflow_id] æ•°æ®éªŒè¯å®Œæˆ" >> $WORKFLOW_LOG
    
    # è§¦å‘ä¸‹ä¸€æ­¥
    execute_workflow_step "process_data" "$data_file" "$workflow_id"
}

# æ•°æ®å¤„ç†æ­¥éª¤
process_workflow_data() {
    local data_file=$1
    local workflow_id=$2
    
    echo "$(date): [$workflow_id] å¼€å§‹æ•°æ®å¤„ç†..." >> $WORKFLOW_LOG
    
    # åˆ›å»ºå¤„ç†ç›®å½•
    process_dir="/tmp/workflow_${workflow_id}"
    mkdir -p "$process_dir"
    
    # æ‰§è¡Œæ•°æ®è½¬æ¢
    if transform_data "$data_file" "$process_dir/processed.csv"; then
        echo "$(date): [$workflow_id] æ•°æ®è½¬æ¢å®Œæˆ" >> $WORKFLOW_LOG
        
        # æ›´æ–°çŠ¶æ€
        echo "processed" > "$WORKFLOW_STATE_DIR/${workflow_id}.state"
        
        # è§¦å‘ä¸‹ä¸€æ­¥
        execute_workflow_step "generate_report" "$process_dir/processed.csv" "$workflow_id"
    else
        echo "$(date): [$workflow_id] æ•°æ®å¤„ç†å¤±è´¥" >> $WORKFLOW_LOG
        return 1
    fi
}

# æŠ¥å‘Šç”Ÿæˆæ­¥éª¤
generate_workflow_report() {
    local processed_data=$1
    local workflow_id=$2
    
    echo "$(date): [$workflow_id] å¼€å§‹ç”ŸæˆæŠ¥å‘Š..." >> $WORKFLOW_LOG
    
    # ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š
    report_file="/tmp/workflow_${workflow_id}/report.html"
    
    python3 << EOF
import pandas as pd
import matplotlib.pyplot as plt

# è¯»å–å¤„ç†åçš„æ•°æ®
df = pd.read_csv('$processed_data')

# ç”Ÿæˆç»Ÿè®¡å›¾è¡¨
fig, ax = plt.subplots(2, 2, figsize=(12, 8))
df.hist(ax=ax)
plt.tight_layout()
plt.savefig('/tmp/workflow_${workflow_id}/charts.png')

# ç”ŸæˆHTMLæŠ¥å‘Š
html_content = f"""
<html>
<head><title>å·¥ä½œæµç¨‹æŠ¥å‘Š - $workflow_id</title></head>
<body>
    <h1>æ•°æ®å¤„ç†æŠ¥å‘Š</h1>
    <p>å·¥ä½œæµID: $workflow_id</p>
    <p>å¤„ç†æ—¶é—´: $(date)</p>
    <p>æ•°æ®è¡Œæ•°: {len(df)}</p>
    <img src="charts.png" alt="æ•°æ®å›¾è¡¨">
</body>
</html>
"""

with open('$report_file', 'w') as f:
    f.write(html_content)

print("æŠ¥å‘Šç”Ÿæˆå®Œæˆ")
EOF
    
    if [ $? -eq 0 ]; then
        echo "$(date): [$workflow_id] æŠ¥å‘Šç”Ÿæˆå®Œæˆ" >> $WORKFLOW_LOG
        echo "report_generated" > "$WORKFLOW_STATE_DIR/${workflow_id}.state"
        
        # è§¦å‘ä¸‹ä¸€æ­¥
        execute_workflow_step "send_notification" "$report_file" "$workflow_id"
    fi
}

# é€šçŸ¥å‘é€æ­¥éª¤
send_workflow_notification() {
    local report_file=$1
    local workflow_id=$2
    
    echo "$(date): [$workflow_id] å‘é€é€šçŸ¥..." >> $WORKFLOW_LOG
    
    # å‘é€é‚®ä»¶é€šçŸ¥
    {
        echo "å·¥ä½œæµç¨‹å®Œæˆé€šçŸ¥"
        echo "å·¥ä½œæµID: $workflow_id"
        echo "å®Œæˆæ—¶é—´: $(date)"
        echo "å¤„ç†çŠ¶æ€: æˆåŠŸ"
    } | mail -s "å·¥ä½œæµç¨‹å®Œæˆ - $workflow_id" \
           -a "$report_file" \
           $NOTIFICATION_EMAIL
    
    # å‘é€ç³»ç»Ÿé€šçŸ¥
    if command -v notify-send >/dev/null; then
        notify-send "å·¥ä½œæµç¨‹" "å·¥ä½œæµ $workflow_id æ‰§è¡Œå®Œæˆ"
    fi
    
    echo "$(date): [$workflow_id] é€šçŸ¥å‘é€å®Œæˆ" >> $WORKFLOW_LOG
    echo "notified" > "$WORKFLOW_STATE_DIR/${workflow_id}.state"
    
    # è§¦å‘æœ€åä¸€æ­¥
    execute_workflow_step "archive_data" "$report_file" "$workflow_id"
}

# æ•°æ®å½’æ¡£æ­¥éª¤
archive_workflow_data() {
    local report_file=$1
    local workflow_id=$2
    
    echo "$(date): [$workflow_id] å¼€å§‹æ•°æ®å½’æ¡£..." >> $WORKFLOW_LOG
    
    # åˆ›å»ºå½’æ¡£ç›®å½•
    archive_date=$(date +%Y/%m/%d)
    archive_dir="/archive/workflows/$archive_date"
    mkdir -p "$archive_dir"
    
    # å½’æ¡£æ‰€æœ‰ç›¸å…³æ–‡ä»¶
    workflow_dir="/tmp/workflow_${workflow_id}"
    tar -czf "$archive_dir/workflow_${workflow_id}.tar.gz" -C "$workflow_dir" .
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -rf "$workflow_dir"
    rm -f "$WORKFLOW_STATE_DIR/${workflow_id}.state"
    
    echo "$(date): [$workflow_id] å·¥ä½œæµç¨‹å®Œæˆå¹¶å½’æ¡£" >> $WORKFLOW_LOG
}

# å¯åŠ¨å·¥ä½œæµç¨‹
start_workflow() {
    local trigger_file=$1
    local workflow_id="WF_$(date +%Y%m%d_%H%M%S)_$$"
    
    echo "$(date): [$workflow_id] å¯åŠ¨å·¥ä½œæµç¨‹ï¼Œè§¦å‘æ–‡ä»¶ï¼š$trigger_file" >> $WORKFLOW_LOG
    
    # åˆå§‹åŒ–å·¥ä½œæµçŠ¶æ€
    echo "started" > "$WORKFLOW_STATE_DIR/${workflow_id}.state"
    
    # å¼€å§‹ç¬¬ä¸€æ­¥
    execute_workflow_step "validate_input" "$trigger_file" "$workflow_id"
}

# ç›‘æ§è§¦å‘ç›®å½•
TRIGGER_DIR="/data/workflow/trigger"

inotifywait -m -e close_write,moved_to \
    --format '%w%f' $TRIGGER_DIR | \
while read trigger_file; do
    echo "$(date): æ£€æµ‹åˆ°å·¥ä½œæµè§¦å‘æ–‡ä»¶ï¼š$(basename "$trigger_file")"
    start_workflow "$trigger_file" &
done
```

### 9.3 å·¥ä½œæµç¨‹ç›‘æ§é¢æ¿


**ğŸ“Š çŠ¶æ€ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# å·¥ä½œæµç¨‹ç›‘æ§é¢æ¿

WORKFLOW_STATE_DIR="/var/lib/workflow/state"
WORKFLOW_LOG="/var/log/workflow.log"

# ç”Ÿæˆç›‘æ§æŠ¥å‘Š
generate_workflow_dashboard() {
    local dashboard_file="/var/www/html/workflow_dashboard.html"
    
    cat > "$dashboard_file" << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <title>å·¥ä½œæµç¨‹ç›‘æ§é¢æ¿</title>
    <meta charset="utf-8">
    <meta http-equiv="refresh" content="30">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .running { background-color: #fff3cd; }
        .completed { background-color: #d4edda; }
        .failed { background-color: #f8d7da; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>å·¥ä½œæµç¨‹ç›‘æ§é¢æ¿</h1>
    <p>æ›´æ–°æ—¶é—´: $(date)</p>
    
    <h2>è¿è¡ŒçŠ¶æ€ç»Ÿè®¡</h2>
EOF
    
    # ç»Ÿè®¡å„çŠ¶æ€çš„å·¥ä½œæµæ•°é‡
    local running_count=$(find $WORKFLOW_STATE_DIR -name "*.state" | wc -l)
    local completed_today=$(grep "å·¥ä½œæµç¨‹å®Œæˆ" $WORKFLOW_LOG | grep "$(date +%Y-%m-%d)" | wc -l)
    local failed_today=$(grep "å¤±è´¥" $WORKFLOW_LOG | grep "$(date +%Y-%m-%d)" | wc -l)
    
    cat >> "$dashboard_file" << EOF
    <div class="status running">è¿è¡Œä¸­: $running_count</div>
    <div class="status completed">ä»Šæ—¥å®Œæˆ: $completed_today</div>
    <div class="status failed">ä»Šæ—¥å¤±è´¥: $failed_today</div>
    
    <h2>æœ€è¿‘å·¥ä½œæµç¨‹</h2>
    <table>
        <tr>
            <th>å·¥ä½œæµID</th>
            <th>çŠ¶æ€</th>
            <th>å¼€å§‹æ—¶é—´</th>
            <th>æŒç»­æ—¶é—´</th>
        </tr>
EOF
    
    # æ˜¾ç¤ºæœ€è¿‘çš„å·¥ä½œæµç¨‹
    tail -20 $WORKFLOW_LOG | grep "å¯åŠ¨å·¥ä½œæµç¨‹" | while read line; do
        workflow_id=$(echo "$line" | grep -o "WF_[0-9_]*")
        start_time=$(echo "$line" | cut -d: -f1-3)
        
        if [ -f "$WORKFLOW_STATE_DIR/${workflow_id}.state" ]; then
            status=$(cat "$WORKFLOW_STATE_DIR/${workflow_id}.state")
            status_class="running"
        else
            status="å·²å®Œæˆ"
            status_class="completed"
        fi
        
        cat >> "$dashboard_file" << EOF
        <tr>
            <td>$workflow_id</td>
            <td><span class="$status_class">$status</span></td>
            <td>$start_time</td>
            <td>-</td>
        </tr>
EOF
    done
    
    cat >> "$dashboard_file" << 'EOF'
    </table>
</body>
</html>
EOF
    
    echo "$(date): ç›‘æ§é¢æ¿å·²æ›´æ–°"
}

# å®šæœŸæ›´æ–°ç›‘æ§é¢æ¿
while true; do
    generate_workflow_dashboard
    sleep 30
done
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ å®æ—¶ç›‘æ§çš„ä»·å€¼**
- **å³æ—¶å“åº”**ï¼šæ–‡ä»¶å˜åŒ–ç«‹å³è§¦å‘å¤„ç†ï¼Œæ— å»¶è¿Ÿ
- **è‡ªåŠ¨åŒ–ç¨‹åº¦**ï¼šå‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜æ•ˆç‡
- **å¯é æ€§ä¿éšœ**ï¼šé¿å…é—æ¼ï¼Œç¡®ä¿å¤„ç†å®Œæ•´æ€§

**ğŸ”§ å…³é”®æŠ€æœ¯ç»„åˆ**
```
inotify + rsync = å®æ—¶åŒæ­¥
inotify + è„šæœ¬ = è‡ªåŠ¨åŒ–å¤„ç†
inotify + å·¥ä½œæµ = ä¸šåŠ¡è‡ªåŠ¨åŒ–
```

### 10.2 å®é™…åº”ç”¨åœºæ™¯æ€»ç»“


| åº”ç”¨åœºæ™¯ | **è§¦å‘äº‹ä»¶** | **å¤„ç†åŠ¨ä½œ** | **ä¸šåŠ¡ä»·å€¼** |
|----------|-------------|-------------|-------------|
| **æ–‡ä»¶åŒæ­¥** | `æ–‡ä»¶ä¿®æ”¹` | `rsyncåŒæ­¥` | `æ•°æ®å¤‡ä»½ä¿æŠ¤` |
| **é…ç½®é‡è½½** | `é…ç½®å˜æ›´` | `æœåŠ¡é‡å¯` | `æ— ç¼é…ç½®æ›´æ–°` |
| **æ—¥å¿—è½®è½¬** | `æ—¥å¿—åˆ‡æ¢` | `å¤‡ä»½å‹ç¼©` | `å­˜å‚¨ç©ºé—´ç®¡ç†` |
| **çƒ­éƒ¨ç½²** | `ä»£ç æ›´æ–°` | `åº”ç”¨é‡è½½` | `æ— åœæœºæ›´æ–°` |
| **å¤‡ä»½è§¦å‘** | `æ•°æ®å˜åŒ–` | `è‡ªåŠ¨å¤‡ä»½` | `æ•°æ®å®‰å…¨ä¿éšœ` |
| **ä¸Šä¼ æ£€æµ‹** | `æ–‡ä»¶å®Œæˆ` | `åç»­å¤„ç†` | `å¤„ç†æµç¨‹è‡ªåŠ¨åŒ–` |
| **ä»»åŠ¡å¯åŠ¨** | `æ•°æ®åˆ°è¾¾` | `æ‰¹å¤„ç†æ‰§è¡Œ` | `ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–` |

### 10.3 æœ€ä½³å®è·µæŒ‡å—


**ğŸ“ è„šæœ¬ç¼–å†™åŸåˆ™**
```bash
# 1. æ·»åŠ æ—¥å¿—è®°å½•
echo "$(date): æ“ä½œä¿¡æ¯" >> $LOG_FILE

# 2. é”™è¯¯å¤„ç†
if [ $? -eq 0 ]; then
    echo "æˆåŠŸ"
else
    echo "å¤±è´¥"
    exit 1
fi

# 3. èµ„æºæ¸…ç†
trap "cleanup" EXIT

# 4. å¹¶å‘æ§åˆ¶
if [ $(ps aux | grep script_name | wc -l) -gt 2 ]; then
    echo "è„šæœ¬å·²åœ¨è¿è¡Œ"
    exit 1
fi
```

**âš ï¸ å¸¸è§æ³¨æ„äº‹é¡¹**
- **é¿å…é¢‘ç¹è§¦å‘**ï¼šä½¿ç”¨å»¶è¿Ÿæœºåˆ¶é¿å…è¿‡åº¦é¢‘ç¹çš„æ“ä½œ
- **é”™è¯¯å¤„ç†**ï¼šç¡®ä¿å¼‚å¸¸æƒ…å†µä¸‹çš„å›æ»šå’Œæ¢å¤æœºåˆ¶
- **èµ„æºç®¡ç†**ï¼šç›‘æ§ç³»ç»Ÿèµ„æºï¼Œé¿å…è¿‡åº¦æ¶ˆè€—
- **æƒé™æ§åˆ¶**ï¼šç¡®ä¿è„šæœ¬å…·æœ‰å¿…è¦çš„æ‰§è¡Œæƒé™
- **æ—¥å¿—ç®¡ç†**ï¼šè¯¦ç»†è®°å½•æ“ä½œè¿‡ç¨‹ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

### 10.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸš€ å¾ªåºæ¸è¿›çš„å­¦ä¹ æ–¹å¼**
```
ç¬¬1å‘¨ï¼šåŸºç¡€æ¦‚å¿µ
- ç†è§£inotifyçš„å·¥ä½œåŸç†
- æŒæ¡åŸºæœ¬çš„æ–‡ä»¶ç›‘æ§å‘½ä»¤
- ç»ƒä¹ ç®€å•çš„è§¦å‘è„šæœ¬

ç¬¬2å‘¨ï¼šå®é™…åº”ç”¨
- å®ç°æ–‡ä»¶åŒæ­¥è‡ªåŠ¨åŒ–
- é…ç½®æœåŠ¡è‡ªåŠ¨é‡è½½
- æ•°æ®å¤‡ä»½è‡ªåŠ¨è§¦å‘

ç¬¬3å‘¨ï¼šé«˜çº§åº”ç”¨
- å·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–
- é”™è¯¯å¤„ç†å’Œå®¹é”™æœºåˆ¶
- æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§

ç¬¬4å‘¨ï¼šä¼ä¸šçº§å®è·µ
- å¤§è§„æ¨¡éƒ¨ç½²å’Œç®¡ç†
- ç›‘æ§é¢æ¿å’ŒæŠ¥å‘Š
- ä¸å…¶ä»–ç³»ç»Ÿé›†æˆ
```

### 10.5 æ•…éšœæ’æŸ¥è¦ç‚¹


**ğŸ” å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ³•**
```
é—®é¢˜1ï¼šinotifyäº‹ä»¶ä¸¢å¤±
è§£å†³ï¼šæ£€æŸ¥ç³»ç»Ÿé™åˆ¶ï¼Œå¢å¤§äº‹ä»¶é˜Ÿåˆ—
echo 8192 > /proc/sys/fs/inotify/max_queued_events

é—®é¢˜2ï¼šè„šæœ¬é‡å¤æ‰§è¡Œ
è§£å†³ï¼šæ·»åŠ é”æ–‡ä»¶æœºåˆ¶
lockfile=/tmp/script.lock
if [ -f "$lockfile" ]; then exit 1; fi
touch "$lockfile"

é—®é¢˜3ï¼šæƒé™ä¸è¶³
è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶å’Œç›®å½•æƒé™
chmod +x script.sh
chown user:group /path/to/directory

é—®é¢˜4ï¼šç›‘æ§åœæ­¢å“åº”
è§£å†³ï¼šæ·»åŠ å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯
while ! pgrep -f inotifywait; do
    restart_monitor
done
```

**ğŸ’¡ è®°å¿†å£è¯€**
- **å®æ—¶ç›‘æ§**ï¼šæ–‡ä»¶ä¸€åŠ¨æˆ‘å°±çŸ¥ï¼Œç«‹å³å¤„ç†ä¸å»¶è¿Ÿ
- **è‡ªåŠ¨åŒæ­¥**ï¼šrsyncé…inotifyï¼Œå˜åŒ–åŒæ­¥é›¶å»¶æ—¶  
- **å·¥ä½œæµç¨‹**ï¼šäº‹ä»¶è§¦å‘è¿æˆé“¾ï¼Œè‡ªåŠ¨å¤„ç†æ•ˆç‡é«˜
- **é”™è¯¯å¤„ç†**ï¼šå¼‚å¸¸æ•è·è¦å®Œå–„ï¼Œæ—¥å¿—è®°å½•å¥½æ’æŸ¥

**æ ¸å¿ƒä»·å€¼ç†è§£**ï¼š
æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ç›‘æ§ä¸ä»…ä»…æ˜¯æŠ€æœ¯å·¥å…·ï¼Œæ›´æ˜¯å®ç°ä¸šåŠ¡è‡ªåŠ¨åŒ–çš„é‡è¦æ‰‹æ®µã€‚é€šè¿‡åˆç†è¿ç”¨inotifyæœºåˆ¶ï¼Œå¯ä»¥æ„å»ºé«˜æ•ˆã€å¯é çš„è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œå¤§å¹…æå‡å·¥ä½œæ•ˆç‡ï¼Œé™ä½äººä¸ºé”™è¯¯ï¼Œå®ç°çœŸæ­£çš„æ™ºèƒ½åŒ–è¿ç»´ã€‚