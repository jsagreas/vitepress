---
title: 15ã€æ€§èƒ½ç›‘æŽ§è„šæœ¬ç¼–å†™
---
## ðŸ“š ç›®å½•

1. [ç›‘æŽ§è„šæœ¬åŸºç¡€æ¦‚å¿µ](#1-ç›‘æŽ§è„šæœ¬åŸºç¡€æ¦‚å¿µ)
2. [Shellè„šæœ¬é›†æˆå¤šå·¥å…·ç›‘æŽ§](#2-Shellè„šæœ¬é›†æˆå¤šå·¥å…·ç›‘æŽ§)
3. [æ€§èƒ½æ•°æ®è‡ªåŠ¨æ”¶é›†è„šæœ¬](#3-æ€§èƒ½æ•°æ®è‡ªåŠ¨æ”¶é›†è„šæœ¬)
4. [ç›‘æŽ§é˜ˆå€¼åˆ¤æ–­ä¸Žå‘Šè­¦](#4-ç›‘æŽ§é˜ˆå€¼åˆ¤æ–­ä¸Žå‘Šè­¦)
5. [cronå®šæ—¶ç›‘æŽ§ä»»åŠ¡è®¾ç½®](#5-cronå®šæ—¶ç›‘æŽ§ä»»åŠ¡è®¾ç½®)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ ç›‘æŽ§è„šæœ¬åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ€§èƒ½ç›‘æŽ§è„šæœ¬


**ðŸ“Œ é€šä¿—ç†è§£**ï¼šç›‘æŽ§è„šæœ¬å°±åƒæ˜¯ç»™æœåŠ¡å™¨é…å¤‡çš„"ä½“æ£€åŒ»ç”Ÿ"
```
ç”Ÿæ´»ç±»æ¯”ï¼š
ä½“æ£€åŒ»ç”Ÿå®šæœŸæ£€æŸ¥ â†’ ç›‘æŽ§è„šæœ¬å®šæœŸæ£€æµ‹
æµ‹é‡è¡€åŽ‹ã€å¿ƒçŽ‡   â†’ æ£€æµ‹CPUã€å†…å­˜ä½¿ç”¨çŽ‡
å‘çŽ°å¼‚å¸¸åŠæ—¶æé†’ â†’ æ€§èƒ½è¶…æ ‡è‡ªåŠ¨å‘Šè­¦
å»ºç«‹å¥åº·æ¡£æ¡ˆ     â†’ è®°å½•åŽ†å²æ€§èƒ½æ•°æ®
```

**ðŸ” æ ¸å¿ƒä½œç”¨**ï¼š
- **è‡ªåŠ¨åŒ–æ£€æµ‹**ï¼šæ— éœ€æ‰‹åŠ¨æ‰§è¡Œç›‘æŽ§å‘½ä»¤
- **æŒç»­ç›‘æŽ§**ï¼š24å°æ—¶ä¸é—´æ–­æ€§èƒ½æ£€æµ‹
- **åŠæ—¶å‘Šè­¦**ï¼šå¼‚å¸¸æƒ…å†µç«‹å³é€šçŸ¥
- **æ•°æ®è®°å½•**ï¼šä¿å­˜åŽ†å²æ€§èƒ½è¶‹åŠ¿

### 1.2 ç›‘æŽ§è„šæœ¬çš„å·¥ä½œåŽŸç†


**ðŸ”„ åŸºæœ¬å·¥ä½œæµç¨‹**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®šæ—¶è§¦å‘   â”‚â”€â”€â”€â†’â”‚  æ”¶é›†æ•°æ®   â”‚â”€â”€â”€â†’â”‚  åˆ†æžåˆ¤æ–­   â”‚
â”‚  (cron)     â”‚    â”‚ (å„ç§å·¥å…·)  â”‚    â”‚ (é˜ˆå€¼æ¯”è¾ƒ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
                           â–¼                    â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  å­˜å‚¨æ•°æ®   â”‚    â”‚  å‘Šè­¦é€šçŸ¥   â”‚
                   â”‚ (æ—¥å¿—æ–‡ä»¶)  â”‚    â”‚ (é‚®ä»¶/çŸ­ä¿¡) â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ðŸ”§ Shellè„šæœ¬é›†æˆå¤šå·¥å…·ç›‘æŽ§


### 2.1 ç›‘æŽ§å·¥å…·æ•´åˆåŽŸç†


**ðŸ’¡ ä¸ºä»€ä¹ˆè¦æ•´åˆå¤šä¸ªå·¥å…·**ï¼š
```
å•ä¸€å·¥å…·çš„å±€é™æ€§ï¼š
- topï¼šåªçœ‹å½“å‰çŠ¶æ€ï¼Œæ— åŽ†å²æ•°æ®
- psï¼šåªçœ‹è¿›ç¨‹ä¿¡æ¯ï¼Œç¼ºä¹ç³»ç»Ÿæ•´ä½“è§†å›¾
- dfï¼šåªçœ‹ç£ç›˜ï¼Œä¸çœ‹å†…å­˜å’ŒCPU

æ•´åˆä¼˜åŠ¿ï¼š
- å…¨é¢è¦†ç›–ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œä¸€æ¬¡æ£€æŸ¥
- æ•°æ®å…³è”ï¼šå¤šç»´åº¦æ•°æ®ç»¼åˆåˆ†æž
- ç»Ÿä¸€è¾“å‡ºï¼šä¸€ä¸ªè„šæœ¬èŽ·å¾—å®Œæ•´æŠ¥å‘Š
```

### 2.2 åŸºç¡€ç›‘æŽ§è„šæœ¬æ¡†æž¶


```bash
#!/bin/bash
# ç³»ç»Ÿæ€§èƒ½ç›‘æŽ§è„šæœ¬

# ðŸ”§ åŸºç¡€é…ç½®
SCRIPT_NAME="system_monitor"
LOG_FILE="/var/log/system_monitor.log"
DATE=$(date '+%Y-%m-%d %H:%M:%S')

# ðŸ“Š æ”¶é›†ç³»ç»Ÿä¿¡æ¯å‡½æ•°
collect_cpu_info() {
    echo "=== CPUä½¿ç”¨æƒ…å†µ ==="
    # èŽ·å–CPUä½¿ç”¨çŽ‡ï¼ˆ1ç§’å†…å¹³å‡å€¼ï¼‰
    cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    echo "CPUä½¿ç”¨çŽ‡: ${cpu_usage}%"
}

collect_memory_info() {
    echo "=== å†…å­˜ä½¿ç”¨æƒ…å†µ ==="
    # èŽ·å–å†…å­˜ä½¿ç”¨ä¿¡æ¯
    free -h | grep -E "Mem|Swap"
}

collect_disk_info() {
    echo "=== ç£ç›˜ä½¿ç”¨æƒ…å†µ ==="
    # æ˜¾ç¤ºç£ç›˜ä½¿ç”¨çŽ‡
    df -h | grep -vE '^tmpfs|^udev'
}

# ðŸŽ¯ ä¸»ç›‘æŽ§å‡½æ•°
main_monitor() {
    echo "[$DATE] å¼€å§‹ç³»ç»Ÿç›‘æŽ§..."
    collect_cpu_info
    collect_memory_info
    collect_disk_info
    echo "ç›‘æŽ§å®Œæˆ"
}

# æ‰§è¡Œç›‘æŽ§
main_monitor
```

### 2.3 è¿›é˜¶ç›‘æŽ§è„šæœ¬


```bash
#!/bin/bash
# å®Œæ•´ç³»ç»Ÿç›‘æŽ§è„šæœ¬

# âš™ï¸ é…ç½®åŒºåŸŸ
CONFIG_FILE="/etc/monitor.conf"
LOG_DIR="/var/log/monitor"
ALERT_EMAIL="admin@company.com"

# ðŸ“ˆ æ•°æ®æ”¶é›†å‡½æ•°ç»„
get_system_load() {
    # èŽ·å–ç³»ç»Ÿè´Ÿè½½
    load_avg=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | cut -d',' -f1)
    echo "ç³»ç»Ÿè´Ÿè½½: $load_avg"
}

get_network_stats() {
    # ç½‘ç»œæµé‡ç»Ÿè®¡
    echo "=== ç½‘ç»œçŠ¶æ€ ==="
    # æ˜¾ç¤ºç½‘ç»œè¿žæŽ¥æ•°
    connections=$(netstat -an | wc -l)
    echo "ç½‘ç»œè¿žæŽ¥æ•°: $connections"
}

get_process_stats() {
    # è¿›ç¨‹ç»Ÿè®¡
    echo "=== è¿›ç¨‹ç»Ÿè®¡ ==="
    # æ€»è¿›ç¨‹æ•°
    total_processes=$(ps aux | wc -l)
    echo "æ€»è¿›ç¨‹æ•°: $total_processes"
    
    # æ˜¾ç¤ºCPUå ç”¨æœ€é«˜çš„5ä¸ªè¿›ç¨‹
    echo "CPUå ç”¨æœ€é«˜è¿›ç¨‹:"
    ps aux --sort=-%cpu | head -6
}

# ðŸ” ç»¼åˆç›‘æŽ§å‡½æ•°
comprehensive_monitor() {
    echo "========== ç³»ç»Ÿæ€§èƒ½ç›‘æŽ§æŠ¥å‘Š =========="
    echo "ç›‘æŽ§æ—¶é—´: $(date)"
    echo ""
    
    get_system_load
    collect_cpu_info
    collect_memory_info
    collect_disk_info
    get_network_stats
    get_process_stats
    
    echo "========================================="
}
```

---

## 3. ðŸ“Š æ€§èƒ½æ•°æ®è‡ªåŠ¨æ”¶é›†è„šæœ¬


### 3.1 æ•°æ®æ”¶é›†ç­–ç•¥


**ðŸŽ¯ æ”¶é›†ä»€ä¹ˆæ•°æ®**ï¼š
```
æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ï¼š
âœ… CPUä½¿ç”¨çŽ‡ã€è´Ÿè½½
âœ… å†…å­˜ä½¿ç”¨é‡ã€å‰©ä½™é‡
âœ… ç£ç›˜ä½¿ç”¨çŽ‡ã€IOç»Ÿè®¡
âœ… ç½‘ç»œæµé‡ã€è¿žæŽ¥æ•°
âœ… è¿›ç¨‹çŠ¶æ€ã€èµ„æºå ç”¨

æ•°æ®æ ¼å¼è¦æ±‚ï¼š
- æ—¶é—´æˆ³ï¼šä¾¿äºŽåŽ†å²åˆ†æž
- æ•°å€¼åŒ–ï¼šä¾¿äºŽé˜ˆå€¼æ¯”è¾ƒ
- ç»“æž„åŒ–ï¼šä¾¿äºŽè§£æžå¤„ç†
```

### 3.2 æ•°æ®æ”¶é›†è„šæœ¬å®žçŽ°


```bash
#!/bin/bash
# æ€§èƒ½æ•°æ®è‡ªåŠ¨æ”¶é›†è„šæœ¬

# ðŸ“ æ•°æ®å­˜å‚¨é…ç½®
DATA_DIR="/var/log/performance"
DATE_FORMAT="%Y-%m-%d_%H-%M-%S"
TIMESTAMP=$(date "+$DATE_FORMAT")

# ðŸ”§ åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p "$DATA_DIR"

# ðŸ“ˆ æ•°æ®æ”¶é›†å‡½æ•°
collect_performance_data() {
    local output_file="$DATA_DIR/perf_${TIMESTAMP}.txt"
    
    echo "# æ€§èƒ½æ•°æ®æ”¶é›† - $(date)" > "$output_file"
    
    # CPUæ•°æ®
    echo "[CPU]" >> "$output_file"
    # èŽ·å–CPUä½¿ç”¨çŽ‡
    sar -u 1 1 | tail -1 | awk '{print "cpu_user=" $3 ",cpu_system=" $5 ",cpu_idle=" $8}' >> "$output_file"
    
    # å†…å­˜æ•°æ®
    echo "[MEMORY]" >> "$output_file"
    # å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆKBä¸ºå•ä½ï¼‰
    free | grep "Mem:" | awk '{print "mem_total=" $2 ",mem_used=" $3 ",mem_free=" $4}' >> "$output_file"
    
    # ç£ç›˜æ•°æ®
    echo "[DISK]" >> "$output_file"
    # ä¸»è¦åˆ†åŒºä½¿ç”¨çŽ‡
    df / | tail -1 | awk '{print "disk_used_percent=" $5}' | sed 's/%//' >> "$output_file"
    
    # ç³»ç»Ÿè´Ÿè½½
    echo "[LOAD]" >> "$output_file"
    uptime | awk -F'load average:' '{print "load_1min=" $2}' | awk '{print $1}' | cut -d',' -f1 >> "$output_file"
    
    echo "æ•°æ®å·²ä¿å­˜åˆ°: $output_file"
}

# ðŸ—‚ï¸ æ•°æ®æ•´ç†å‡½æ•°
organize_data() {
    # ç”ŸæˆCSVæ ¼å¼çš„æ—¥æ±‡æ€»
    local csv_file="$DATA_DIR/daily_$(date +%Y%m%d).csv"
    
    if [ ! -f "$csv_file" ]; then
        # åˆ›å»ºCSVå¤´éƒ¨
        echo "timestamp,cpu_user,cpu_system,cpu_idle,mem_used_mb,disk_used_percent,load_1min" > "$csv_file"
    fi
    
    # æå–ä»Šå¤©çš„æ•°æ®å¹¶è½¬æ¢ä¸ºCSVæ ¼å¼
    # ï¼ˆè¿™é‡Œæ˜¯ç®€åŒ–ç¤ºä¾‹ï¼Œå®žé™…ä¸­éœ€è¦è§£æžä¸Šé¢ç”Ÿæˆçš„æ–‡ä»¶ï¼‰
    echo "$(date '+%Y-%m-%d %H:%M:%S'),5.2,2.1,92.7,2048,75,0.8" >> "$csv_file"
}

# æ‰§è¡Œæ•°æ®æ”¶é›†
collect_performance_data
organize_data
```

### 3.3 æ•°æ®æ¸…ç†ä¸Žç»´æŠ¤


```bash
#!/bin/bash
# æ•°æ®ç»´æŠ¤è„šæœ¬

# ðŸ§¹ æ¸…ç†æ—§æ•°æ®
cleanup_old_data() {
    local keep_days=30
    
    echo "æ¸…ç† $keep_days å¤©å‰çš„ç›‘æŽ§æ•°æ®..."
    
    # åˆ é™¤30å¤©å‰çš„è¯¦ç»†æ•°æ®æ–‡ä»¶
    find "$DATA_DIR" -name "perf_*.txt" -mtime +$keep_days -delete
    
    # ä¿ç•™CSVæ±‡æ€»æ–‡ä»¶æ›´é•¿æ—¶é—´ï¼ˆ90å¤©ï¼‰
    find "$DATA_DIR" -name "daily_*.csv" -mtime +90 -delete
    
    echo "æ•°æ®æ¸…ç†å®Œæˆ"
}

# ðŸ“Š ç”Ÿæˆæ•°æ®æŠ¥å‘Š
generate_summary() {
    echo "=== æœ¬å‘¨æ€§èƒ½æ•°æ®æ‘˜è¦ ==="
    
    # ç»Ÿè®¡æœ¬å‘¨çš„æ•°æ®æ–‡ä»¶æ•°é‡
    week_files=$(find "$DATA_DIR" -name "perf_*.txt" -mtime -7 | wc -l)
    echo "æœ¬å‘¨ç›‘æŽ§æ¬¡æ•°: $week_files"
    
    # è®¡ç®—å¹³å‡å€¼ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
    echo "å¹³å‡CPUä½¿ç”¨çŽ‡: çº¦15%"
    echo "å¹³å‡å†…å­˜ä½¿ç”¨: çº¦2.5GB"
    echo "ç£ç›˜ä½¿ç”¨çŽ‡: çº¦70%"
}
```

---

## 4. âš ï¸ ç›‘æŽ§é˜ˆå€¼åˆ¤æ–­ä¸Žå‘Šè­¦


### 4.1 é˜ˆå€¼è®¾å®šåŽŸç†


**ðŸŽ¯ ä»€ä¹ˆæ˜¯ç›‘æŽ§é˜ˆå€¼**ï¼š
```
ç”Ÿæ´»ç±»æ¯”ï¼š
ä½“æ¸©è¶…è¿‡37.5Â°C â†’ å‘çƒ§è­¦æŠ¥
CPUä½¿ç”¨çŽ‡è¶…è¿‡80% â†’ æ€§èƒ½è­¦æŠ¥

é˜ˆå€¼ç±»åž‹ï¼š
ðŸŸ¢ å®‰å…¨åŒºé—´ï¼š0-60%ï¼ˆæ­£å¸¸ï¼‰
ðŸŸ¡ è­¦å‘ŠåŒºé—´ï¼š60-80%ï¼ˆæ³¨æ„ï¼‰
ðŸ”´ å±é™©åŒºé—´ï¼š80%ä»¥ä¸Šï¼ˆå‘Šè­¦ï¼‰
```

**ðŸ“Š å¸¸ç”¨é˜ˆå€¼è®¾å®š**ï¼š
```
CPUä½¿ç”¨çŽ‡ï¼š
- è­¦å‘Š: 70%
- å±é™©: 85%

å†…å­˜ä½¿ç”¨çŽ‡ï¼š
- è­¦å‘Š: 80%
- å±é™©: 90%

ç£ç›˜ä½¿ç”¨çŽ‡ï¼š
- è­¦å‘Š: 80%
- å±é™©: 95%

ç³»ç»Ÿè´Ÿè½½ï¼š
- è­¦å‘Š: CPUæ ¸æ•°
- å±é™©: CPUæ ¸æ•° Ã— 2
```

### 4.2 é˜ˆå€¼åˆ¤æ–­è„šæœ¬


```bash
#!/bin/bash
# æ€§èƒ½é˜ˆå€¼ç›‘æŽ§ä¸Žå‘Šè­¦è„šæœ¬

# âš™ï¸ é˜ˆå€¼é…ç½®
CPU_WARNING=70
CPU_CRITICAL=85
MEM_WARNING=80
MEM_CRITICAL=90
DISK_WARNING=80
DISK_CRITICAL=95

# ðŸ“§ å‘Šè­¦é…ç½®
ALERT_EMAIL="admin@company.com"
ALERT_LOG="/var/log/alerts.log"

# ðŸ” æ£€æŸ¥CPUä½¿ç”¨çŽ‡
check_cpu() {
    # èŽ·å–CPUä½¿ç”¨çŽ‡
    cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1 | cut -d',' -f1)
    cpu_value=${cpu_usage%.*}  # åŽ»æŽ‰å°æ•°éƒ¨åˆ†
    
    if [ "$cpu_value" -gt "$CPU_CRITICAL" ]; then
        send_alert "CRITICAL" "CPUä½¿ç”¨çŽ‡è¾¾åˆ° ${cpu_usage}%ï¼Œè¶…è¿‡å±é™©é˜ˆå€¼ ${CPU_CRITICAL}%"
        return 2
    elif [ "$cpu_value" -gt "$CPU_WARNING" ]; then
        send_alert "WARNING" "CPUä½¿ç”¨çŽ‡è¾¾åˆ° ${cpu_usage}%ï¼Œè¶…è¿‡è­¦å‘Šé˜ˆå€¼ ${CPU_WARNING}%"
        return 1
    fi
    return 0
}

# ðŸ§  æ£€æŸ¥å†…å­˜ä½¿ç”¨çŽ‡
check_memory() {
    # è®¡ç®—å†…å­˜ä½¿ç”¨çŽ‡
    mem_info=$(free | grep "Mem:")
    mem_total=$(echo $mem_info | awk '{print $2}')
    mem_used=$(echo $mem_info | awk '{print $3}')
    mem_usage=$((mem_used * 100 / mem_total))
    
    if [ "$mem_usage" -gt "$MEM_CRITICAL" ]; then
        send_alert "CRITICAL" "å†…å­˜ä½¿ç”¨çŽ‡è¾¾åˆ° ${mem_usage}%ï¼Œè¶…è¿‡å±é™©é˜ˆå€¼ ${MEM_CRITICAL}%"
        return 2
    elif [ "$mem_usage" -gt "$MEM_WARNING" ]; then
        send_alert "WARNING" "å†…å­˜ä½¿ç”¨çŽ‡è¾¾åˆ° ${mem_usage}%ï¼Œè¶…è¿‡è­¦å‘Šé˜ˆå€¼ ${MEM_WARNING}%"
        return 1
    fi
    return 0
}

# ðŸ’¾ æ£€æŸ¥ç£ç›˜ä½¿ç”¨çŽ‡
check_disk() {
    # æ£€æŸ¥æ ¹åˆ†åŒºä½¿ç”¨çŽ‡
    disk_usage=$(df / | tail -1 | awk '{print $5}' | cut -d'%' -f1)
    
    if [ "$disk_usage" -gt "$DISK_CRITICAL" ]; then
        send_alert "CRITICAL" "ç£ç›˜ä½¿ç”¨çŽ‡è¾¾åˆ° ${disk_usage}%ï¼Œè¶…è¿‡å±é™©é˜ˆå€¼ ${DISK_CRITICAL}%"
        return 2
    elif [ "$disk_usage" -gt "$DISK_WARNING" ]; then
        send_alert "WARNING" "ç£ç›˜ä½¿ç”¨çŽ‡è¾¾åˆ° ${disk_usage}%ï¼Œè¶…è¿‡è­¦å‘Šé˜ˆå€¼ ${DISK_WARNING}%"
        return 1
    fi
    return 0
}

# ðŸ“¬ å‘é€å‘Šè­¦å‡½æ•°
send_alert() {
    local level=$1
    local message=$2
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # è®°å½•åˆ°å‘Šè­¦æ—¥å¿—
    echo "[$timestamp] $level: $message" >> "$ALERT_LOG"
    
    # å‘é€é‚®ä»¶å‘Šè­¦ï¼ˆéœ€è¦é…ç½®é‚®ä»¶æœåŠ¡ï¼‰
    echo "æ—¶é—´: $timestamp
çº§åˆ«: $level
è¯¦æƒ…: $message
ä¸»æœº: $(hostname)" | mail -s "ç³»ç»Ÿç›‘æŽ§å‘Šè­¦ - $level" "$ALERT_EMAIL"
    
    echo "å‘Šè­¦å·²å‘é€: $level - $message"
}

# ðŸŽ¯ ä¸»æ£€æŸ¥å‡½æ•°
main_check() {
    echo "å¼€å§‹æ€§èƒ½é˜ˆå€¼æ£€æŸ¥..."
    
    check_cpu
    cpu_status=$?
    
    check_memory
    mem_status=$?
    
    check_disk
    disk_status=$?
    
    # è¿”å›žæœ€é«˜çº§åˆ«çš„çŠ¶æ€
    if [ $cpu_status -eq 2 ] || [ $mem_status -eq 2 ] || [ $disk_status -eq 2 ]; then
        echo "æ£€æŸ¥å®Œæˆ - å‘çŽ°å±é™©çº§åˆ«é—®é¢˜"
        exit 2
    elif [ $cpu_status -eq 1 ] || [ $mem_status -eq 1 ] || [ $disk_status -eq 1 ]; then
        echo "æ£€æŸ¥å®Œæˆ - å‘çŽ°è­¦å‘Šçº§åˆ«é—®é¢˜"
        exit 1
    else
        echo "æ£€æŸ¥å®Œæˆ - ç³»ç»ŸçŠ¶æ€æ­£å¸¸"
        exit 0
    fi
}
```

### 4.3 æ™ºèƒ½å‘Šè­¦ç­–ç•¥


```bash
# ðŸ”” é˜²æ­¢å‘Šè­¦é£Žæš´çš„æ™ºèƒ½ç­–ç•¥
ALERT_INTERVAL=300  # 5åˆ†é’Ÿå†…ç›¸åŒå‘Šè­¦åªå‘é€ä¸€æ¬¡

is_recent_alert() {
    local alert_type=$1
    local last_alert_file="/tmp/last_${alert_type}_alert"
    
    if [ -f "$last_alert_file" ]; then
        local last_time=$(cat "$last_alert_file")
        local current_time=$(date +%s)
        local diff=$((current_time - last_time))
        
        if [ $diff -lt $ALERT_INTERVAL ]; then
            return 0  # æœ€è¿‘å‘é€è¿‡
        fi
    fi
    
    # æ›´æ–°æœ€åŽå‘Šè­¦æ—¶é—´
    date +%s > "$last_alert_file"
    return 1  # å¯ä»¥å‘é€å‘Šè­¦
}

# ðŸ“± å¤šæ¸ é“å‘Šè­¦å‘é€
send_multi_alert() {
    local level=$1
    local message=$2
    
    # æ£€æŸ¥æ˜¯å¦ä¸ºé‡å¤å‘Šè­¦
    if is_recent_alert "${level}_system"; then
        echo "è·³è¿‡é‡å¤å‘Šè­¦: $message"
        return
    fi
    
    # é‚®ä»¶å‘Šè­¦
    send_email_alert "$level" "$message"
    
    # çŸ­ä¿¡å‘Šè­¦ï¼ˆä»…å±é™©çº§åˆ«ï¼‰
    if [ "$level" = "CRITICAL" ]; then
        send_sms_alert "$message"
    fi
    
    # æ—¥å¿—è®°å½•
    log_alert "$level" "$message"
}
```

---

## 5. â° cronå®šæ—¶ç›‘æŽ§ä»»åŠ¡è®¾ç½®


### 5.1 cronåŸºç¡€æ¦‚å¿µ


**ðŸ• ä»€ä¹ˆæ˜¯cron**ï¼š
```
ç®€å•ç†è§£ï¼šcronå°±æ˜¯Linuxç³»ç»Ÿçš„"é—¹é’Ÿ"
ä½œç”¨ï¼šæŒ‰ç…§è®¾å®šçš„æ—¶é—´è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡

ç”Ÿæ´»ç±»æ¯”ï¼š
å®šé—¹é’Ÿ 7:00 èµ·åºŠ â†’ cron 0 7 * * * /path/to/script
æ¯å‘¨ä¸‰æé†’å¼€ä¼š   â†’ cron 0 14 * * 3 /path/to/meeting
```

**ðŸ“… cronæ—¶é—´æ ¼å¼**ï¼š
```
åˆ†é’Ÿ å°æ—¶ æ—¥æœŸ æœˆä»½ æ˜ŸæœŸ å‘½ä»¤
 â†“   â†“   â†“   â†“   â†“    â†“
 0   2   *   *   *  /path/script

è§£é‡Šï¼šæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œè„šæœ¬

æ—¶é—´å­—æ®µè¯´æ˜Žï¼š
åˆ†é’Ÿ: 0-59
å°æ—¶: 0-23
æ—¥æœŸ: 1-31
æœˆä»½: 1-12
æ˜ŸæœŸ: 0-7 (0å’Œ7éƒ½è¡¨ç¤ºæ˜ŸæœŸæ—¥)
```

### 5.2 ç›‘æŽ§ä»»åŠ¡æ—¶é—´è§„åˆ’


```bash
# ðŸ“‹ ç›‘æŽ§é¢‘çŽ‡è§„åˆ’è¡¨
ç›‘æŽ§ç±»åž‹          é¢‘çŽ‡            cronè¡¨è¾¾å¼
ç³»ç»ŸåŸºç¡€ç›‘æŽ§      æ¯5åˆ†é’Ÿ         */5 * * * *
è¯¦ç»†æ€§èƒ½æ”¶é›†      æ¯15åˆ†é’Ÿ        */15 * * * *
ç£ç›˜ç©ºé—´æ£€æŸ¥      æ¯å°æ—¶          0 * * * *
ç³»ç»Ÿå¥åº·æŠ¥å‘Š      æ¯å¤©8ç‚¹         0 8 * * *
å‘¨åº¦æ€§èƒ½æ±‡æ€»      æ¯å‘¨ä¸€9ç‚¹       0 9 * * 1
æœˆåº¦è¶‹åŠ¿åˆ†æž      æ¯æœˆ1å·10ç‚¹     0 10 1 * *
```

### 5.3 cronä»»åŠ¡é…ç½®å®žè·µ


```bash
# ðŸ”§ ç¼–è¾‘cronä»»åŠ¡
# æ‰§è¡Œå‘½ä»¤ï¼šcrontab -e

# âš¡ åŸºç¡€ç›‘æŽ§ä»»åŠ¡
# æ¯5åˆ†é’Ÿæ£€æŸ¥ç³»ç»ŸçŠ¶æ€
*/5 * * * * /usr/local/bin/quick_monitor.sh >> /var/log/quick_monitor.log 2>&1

# ðŸ“Š è¯¦ç»†ç›‘æŽ§ä»»åŠ¡
# æ¯15åˆ†é’Ÿæ”¶é›†è¯¦ç»†æ€§èƒ½æ•°æ®
*/15 * * * * /usr/local/bin/detailed_monitor.sh

# ðŸš¨ å‘Šè­¦æ£€æŸ¥ä»»åŠ¡
# æ¯åˆ†é’Ÿæ£€æŸ¥å‘Šè­¦é˜ˆå€¼
* * * * * /usr/local/bin/alert_check.sh

# ðŸ“ˆ æŠ¥å‘Šç”Ÿæˆä»»åŠ¡
# æ¯å¤©æ—©ä¸Š8ç‚¹ç”Ÿæˆæ˜¨æ—¥æŠ¥å‘Š
0 8 * * * /usr/local/bin/daily_report.sh

# ðŸ§¹ ç»´æŠ¤ä»»åŠ¡
# æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ¸…ç†æ—§æ•°æ®
0 2 * * 0 /usr/local/bin/cleanup_data.sh
```

### 5.4 cronä»»åŠ¡ç®¡ç†è„šæœ¬


```bash
#!/bin/bash
# cronç›‘æŽ§ä»»åŠ¡ç®¡ç†è„šæœ¬

# ðŸ“ é…ç½®è·¯å¾„
CRON_CONFIG="/etc/cron.d/system_monitor"
SCRIPT_DIR="/usr/local/bin"

# ðŸ”§ å®‰è£…ç›‘æŽ§ä»»åŠ¡
install_cron_jobs() {
    echo "å®‰è£…ç³»ç»Ÿç›‘æŽ§cronä»»åŠ¡..."
    
    # åˆ›å»ºcroné…ç½®æ–‡ä»¶
    cat > "$CRON_CONFIG" << 'EOF'
# ç³»ç»Ÿç›‘æŽ§å®šæ—¶ä»»åŠ¡
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# åŸºç¡€ç›‘æŽ§ï¼ˆæ¯5åˆ†é’Ÿï¼‰
*/5 * * * * root /usr/local/bin/basic_monitor.sh

# æ€§èƒ½æ•°æ®æ”¶é›†ï¼ˆæ¯15åˆ†é’Ÿï¼‰
*/15 * * * * root /usr/local/bin/perf_collect.sh

# é˜ˆå€¼å‘Šè­¦æ£€æŸ¥ï¼ˆæ¯åˆ†é’Ÿï¼‰
* * * * * root /usr/local/bin/threshold_check.sh

# æ—¥æŠ¥ç”Ÿæˆï¼ˆæ¯å¤©8ç‚¹ï¼‰
0 8 * * * root /usr/local/bin/daily_report.sh

# æ•°æ®æ¸…ç†ï¼ˆæ¯å‘¨æ—¥2ç‚¹ï¼‰
0 2 * * 0 root /usr/local/bin/data_cleanup.sh
EOF
    
    echo "cronä»»åŠ¡å®‰è£…å®Œæˆ"
}

# ðŸ“Š æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
check_cron_status() {
    echo "=== cronä»»åŠ¡çŠ¶æ€æ£€æŸ¥ ==="
    
    # æ£€æŸ¥cronæœåŠ¡çŠ¶æ€
    if systemctl is-active --quiet cron; then
        echo "âœ… cronæœåŠ¡è¿è¡Œæ­£å¸¸"
    else
        echo "âŒ cronæœåŠ¡æœªè¿è¡Œ"
        return 1
    fi
    
    # æ£€æŸ¥ç›‘æŽ§è„šæœ¬æ˜¯å¦å­˜åœ¨
    local scripts=("basic_monitor.sh" "perf_collect.sh" "threshold_check.sh")
    for script in "${scripts[@]}"; do
        if [ -x "$SCRIPT_DIR/$script" ]; then
            echo "âœ… $script å­˜åœ¨ä¸”å¯æ‰§è¡Œ"
        else
            echo "âŒ $script ä¸å­˜åœ¨æˆ–æ— æ‰§è¡Œæƒé™"
        fi
    done
}

# ðŸ“ æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—
view_cron_logs() {
    echo "=== æœ€è¿‘çš„cronæ‰§è¡Œæ—¥å¿— ==="
    
    # æ˜¾ç¤ºæœ€è¿‘10æ¡cronæ—¥å¿—
    tail -10 /var/log/cron
    
    echo ""
    echo "=== ç›‘æŽ§è„šæœ¬æ‰§è¡Œç»“æžœ ==="
    
    # æ˜¾ç¤ºç›‘æŽ§æ—¥å¿—
    if [ -f "/var/log/system_monitor.log" ]; then
        tail -5 /var/log/system_monitor.log
    else
        echo "ç›‘æŽ§æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨"
    fi
}

# ðŸŽ¯ ä¸»å‡½æ•°
case "$1" in
    install)
        install_cron_jobs
        ;;
    status)
        check_cron_status
        ;;
    logs)
        view_cron_logs
        ;;
    *)
        echo "ç”¨æ³•: $0 {install|status|logs}"
        echo "  install - å®‰è£…ç›‘æŽ§cronä»»åŠ¡"
        echo "  status  - æ£€æŸ¥ä»»åŠ¡çŠ¶æ€"
        echo "  logs    - æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—"
        exit 1
        ;;
esac
```

---

## 6. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸŽ¯ **ç›‘æŽ§è„šæœ¬æœ¬è´¨**ï¼šè‡ªåŠ¨åŒ–çš„ç³»ç»Ÿå¥åº·æ£€æŸ¥å·¥å…·
ðŸ”§ **å·¥å…·æ•´åˆåŽŸç†**ï¼šå¤šä¸ªç›‘æŽ§å‘½ä»¤ç»„åˆï¼Œå®žçŽ°å…¨é¢ç›‘æŽ§
ðŸ“Š **æ•°æ®æ”¶é›†ç­–ç•¥**ï¼šå®šæ—¶æ”¶é›†ã€ç»“æž„åŒ–å­˜å‚¨ã€ä¾¿äºŽåˆ†æž
âš ï¸ **é˜ˆå€¼å‘Šè­¦æœºåˆ¶**ï¼šè®¾å®šå®‰å…¨è¾¹ç•Œï¼Œè¶…é™è‡ªåŠ¨é€šçŸ¥
â° **å®šæ—¶ä»»åŠ¡ç®¡ç†**ï¼šé€šè¿‡cronå®žçŽ°æ— äººå€¼å®ˆç›‘æŽ§
```

### 6.2 å…³é”®å®žè·µè¦ç‚¹


**ðŸ”¹ è„šæœ¬ç¼–å†™åŽŸåˆ™**
```
æ¨¡å—åŒ–è®¾è®¡ï¼š
- åŠŸèƒ½åˆ†ç¦»ï¼šç›‘æŽ§ã€å‘Šè­¦ã€æ•°æ®å¤„ç†ç‹¬ç«‹
- é…ç½®å¤–ç½®ï¼šé˜ˆå€¼ã€è·¯å¾„ç­‰å‚æ•°å¯é…ç½®
- é”™è¯¯å¤„ç†ï¼šå¼‚å¸¸æƒ…å†µæœ‰å¯¹åº”å¤„ç†é€»è¾‘

å¯ç»´æŠ¤æ€§ï¼š
- æ—¥å¿—è®°å½•ï¼šæ“ä½œè¿‡ç¨‹è¯¦ç»†è®°å½•
- æ³¨é‡Šå®Œæ•´ï¼šå…³é”®é€»è¾‘æœ‰æ¸…æ™°è¯´æ˜Ž
- ç‰ˆæœ¬ç®¡ç†ï¼šè„šæœ¬å˜æ›´æœ‰ç‰ˆæœ¬æŽ§åˆ¶
```

**ðŸ”¹ ç›‘æŽ§é¢‘çŽ‡å¹³è¡¡**
```
é«˜é¢‘ç›‘æŽ§ï¼ˆ1-5åˆ†é’Ÿï¼‰ï¼š
âœ… CPUã€å†…å­˜ä½¿ç”¨çŽ‡
âœ… å…³é”®è¿›ç¨‹çŠ¶æ€
âœ… å‘Šè­¦é˜ˆå€¼æ£€æŸ¥

ä¸­é¢‘ç›‘æŽ§ï¼ˆ15-60åˆ†é’Ÿï¼‰ï¼š
âœ… è¯¦ç»†æ€§èƒ½æ•°æ®
âœ… ç£ç›˜ç©ºé—´æ£€æŸ¥
âœ… ç½‘ç»œæµé‡ç»Ÿè®¡

ä½Žé¢‘ç›‘æŽ§ï¼ˆæ¯æ—¥/æ¯å‘¨ï¼‰ï¼š
âœ… ç³»ç»Ÿå¥åº·æŠ¥å‘Š
âœ… æ€§èƒ½è¶‹åŠ¿åˆ†æž
âœ… æ•°æ®æ¸…ç†ç»´æŠ¤
```

**ðŸ”¹ å‘Šè­¦ç­–ç•¥è®¾è®¡**
```
åˆ†çº§å‘Šè­¦ï¼š
ðŸŸ¢ ä¿¡æ¯çº§ï¼šè®°å½•æ—¥å¿—ï¼Œæ— éœ€é€šçŸ¥
ðŸŸ¡ è­¦å‘Šçº§ï¼šé‚®ä»¶é€šçŸ¥ï¼Œéœ€è¦å…³æ³¨
ðŸ”´ å±é™©çº§ï¼šå¤šæ¸ é“é€šçŸ¥ï¼Œç«‹å³å¤„ç†

é˜²é£Žæš´æœºåˆ¶ï¼š
- ç›¸åŒå‘Šè­¦é—´éš”é™åˆ¶
- å‘Šè­¦å‡çº§ç­–ç•¥
- æ¢å¤çŠ¶æ€é€šçŸ¥
```

### 6.3 ç”Ÿäº§çŽ¯å¢ƒæœ€ä½³å®žè·µ


**ðŸ’¼ ä¼ä¸šçº§ç›‘æŽ§éƒ¨ç½²**
```
ç›®å½•ç»“æž„è§„åˆ’ï¼š
/opt/monitoring/
â”œâ”€â”€ scripts/          # ç›‘æŽ§è„šæœ¬
â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ logs/             # æ—¥å¿—ç›®å½•
â”œâ”€â”€ data/             # æ•°æ®ç›®å½•
â””â”€â”€ alerts/           # å‘Šè­¦è®°å½•

æƒé™å®‰å…¨ï¼š
- è„šæœ¬æ‰§è¡Œæƒé™æœ€å°åŒ–
- æ•æ„Ÿé…ç½®æ–‡ä»¶åŠ å¯†
- æ—¥å¿—æ–‡ä»¶è®¿é—®æŽ§åˆ¶

å¤‡ä»½ç­–ç•¥ï¼š
- é…ç½®æ–‡ä»¶å®šæœŸå¤‡ä»½
- åŽ†å²æ•°æ®å½’æ¡£ç­–ç•¥
- è„šæœ¬ç‰ˆæœ¬ç®¡ç†
```

**ðŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```
è„šæœ¬æ€§èƒ½ï¼š
- é¿å…é¢‘ç¹çš„ç£ç›˜IO
- ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
- å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹çš„æ£€æŸ¥ä»»åŠ¡

èµ„æºå ç”¨ï¼š
- ç›‘æŽ§è„šæœ¬æœ¬èº«èµ„æºæ¶ˆè€—æŽ§åˆ¶
- æ•°æ®å­˜å‚¨ç©ºé—´ç®¡ç†
- ç½‘ç»œå¸¦å®½ä½¿ç”¨ä¼˜åŒ–

æ‰©å±•æ€§ï¼š
- æ”¯æŒå¤šæœåŠ¡å™¨é›†ä¸­ç›‘æŽ§
- é…ç½®æ¨¡æ¿åŒ–ç®¡ç†
- ç›‘æŽ§æŒ‡æ ‡å¯æ‰©å±•
```

### 6.4 æ•…éšœæŽ’æŸ¥æŒ‡å—


**ðŸ” å¸¸è§é—®é¢˜è¯Šæ–­**
```
è„šæœ¬ä¸æ‰§è¡Œï¼š
1. æ£€æŸ¥cronæœåŠ¡çŠ¶æ€
2. éªŒè¯è„šæœ¬æ‰§è¡Œæƒé™
3. æŸ¥çœ‹cronæ—¥å¿—

æ•°æ®å¼‚å¸¸ï¼š
1. æ£€æŸ¥é‡‡é›†å‘½ä»¤æ˜¯å¦æ­£å¸¸
2. éªŒè¯æ•°æ®è§£æžé€»è¾‘
3. ç¡®è®¤å­˜å‚¨è·¯å¾„æƒé™

å‘Šè­¦å¤±æ•ˆï¼š
1. æµ‹è¯•é‚®ä»¶å‘é€åŠŸèƒ½
2. æ£€æŸ¥é˜ˆå€¼é…ç½®
3. éªŒè¯å‘Šè­¦é€»è¾‘
```

**ðŸ§  æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç›‘æŽ§è„šæœ¬æ˜¯ç³»ç»Ÿè¿ç»´çš„"è‡ªåŠ¨åŒ–å“¨å…µ"
- å·¥å…·æ•´åˆè®©ç›‘æŽ§æ›´å…¨é¢ï¼Œæ•°æ®æ”¶é›†è¦ç»“æž„åŒ–
- é˜ˆå€¼è®¾å®šéœ€è¦å¹³è¡¡æ•æ„Ÿåº¦å’Œå‡†ç¡®æ€§
- cronå®šæ—¶ä»»åŠ¡æ˜¯å®žçŽ°æ— äººå€¼å®ˆçš„å…³é”®
- ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²è¦è€ƒè™‘å®‰å…¨ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§