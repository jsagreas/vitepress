---
title: 10、dstat综合系统监控
---
## 📚 目录

1. [dstat工具基础概念](#1-dstat工具基础概念)
2. [多维度实时监控功能](#2-多维度实时监控功能)
3. [自定义监控模块与配置](#3-自定义监控模块与配置)
4. [彩色输出与数据可视化](#4-彩色输出与数据可视化)
5. [监控数据导出与保存](#5-监控数据导出与保存)
6. [系统瓶颈快速识别技巧](#6-系统瓶颈快速识别技巧)
7. [资源使用趋势观察方法](#7-资源使用趋势观察方法)
8. [综合性能分析实战](#8-综合性能分析实战)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🔍 dstat工具基础概念


### 1.1 什么是dstat


**通俗理解**：dstat就像是系统的"体检仪器"，能同时监测你电脑的CPU、内存、硬盘、网络等各个"器官"的健康状况，而且是实时显示的。

```
生活比喻：
汽车仪表盘 → dstat监控界面
速度表     → CPU使用率
油量表     → 内存使用量  
水温表     → 系统温度
里程表     → 磁盘使用量
```

**🔸 dstat的核心价值**
- **统一监控**：一个命令监控多个系统资源
- **实时更新**：动态显示系统状态变化
- **直观显示**：彩色输出，一目了然
- **灵活配置**：可以选择性监控特定资源
- **数据导出**：支持保存监控数据用于分析

### 1.2 dstat与其他监控工具对比


**📊 工具功能对比表**

| 工具 | **监控内容** | **实时性** | **易用性** | **适用场景** |
|------|-------------|-----------|-----------|-------------|
| `top` | `进程+CPU+内存` | `高` | `中等` | `进程监控` |
| `htop` | `进程+系统资源` | `高` | `好` | `交互式监控` |
| `iostat` | `磁盘IO` | `中` | `中等` | `磁盘性能分析` |
| `netstat` | `网络连接` | `低` | `中等` | `网络状态查看` |
| `dstat` | `全面系统资源` | `高` | `好` | `综合性能监控` |

**🎯 dstat的独特优势**
- **一站式监控**：不需要切换多个工具
- **模块化设计**：按需选择监控项目
- **输出格式友好**：支持人类阅读和机器处理
- **轻量级运行**：对系统资源消耗很小

### 1.3 dstat安装与基本使用


**📦 安装dstat**
```bash
# CentOS/RHEL系统
sudo yum install dstat

# Ubuntu/Debian系统  
sudo apt-get install dstat

# 验证安装
dstat --version
```

**🚀 最简单的使用**
```bash
# 最基本的监控（默认显示CPU、磁盘、网络、分页、系统）
dstat

# 输出示例：
#----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
#usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw 
# 15   2  82   1   0   0|  12k   34k|   0     0 |   0     0 | 156   342
# 18   3  78   1   0   0|   0   128k|  52B    0 |   0     0 | 189   401
```

**💡 基本输出含义解释**
- **usr**：用户进程CPU使用百分比
- **sys**：系统进程CPU使用百分比  
- **idl**：CPU空闲百分比
- **wai**：等待IO的CPU百分比
- **read/writ**：磁盘读写速度
- **recv/send**：网络接收发送速度

---

## 2. 📈 多维度实时监控功能


### 2.1 CPU监控详解


**🔸 CPU相关监控选项**
```bash
# 详细CPU监控
dstat -c

# CPU使用率分类显示
dstat --cpu

# 查看每个CPU核心使用情况
dstat -C 0,1,2,3

# 显示CPU使用的具体进程
dstat --top-cpu
```

**📊 CPU监控输出理解**
```
CPU监控输出解析：
----total-cpu-usage----
usr sys idl wai hiq siq
 25   5  65   5   0   0

含义说明：
usr(25%) - 用户程序占用CPU
sys(5%)  - 系统内核占用CPU  
idl(65%) - CPU空闲时间
wai(5%)  - 等待磁盘IO的时间
hiq(0%)  - 硬件中断处理时间
siq(0%)  - 软件中断处理时间
```

**⚠️ CPU性能问题识别**
```
性能问题判断标准：
✅ 正常状态：usr + sys < 80%, idl > 20%
⚠️ 轻微压力：usr + sys = 80-90%
❌ 性能瓶颈：usr + sys > 90%
🔥 严重问题：wai > 20%（IO瓶颈）
```

### 2.2 内存监控详解


**🔸 内存相关监控**
```bash
# 内存使用监控
dstat -m

# 详细内存信息
dstat --mem

# 内存使用最多的进程
dstat --top-mem

# 交换分区监控
dstat -s
```

**📊 内存监控示例**
```bash
# 综合内存监控
dstat -m -s --top-mem

# 输出示例：
#------memory-usage----- ----swap--- --most-expensive--
# used  buff  cach  free| used  free|  memory process  
# 2.1G  156M  1.2G  4.5G|   0    2G| java     1.8G
# 2.3G  156M  1.2G  4.3G|   0    2G| mysql    1.2G
```

**💡 内存状态理解**
- **used**：已使用的物理内存
- **buff**：缓冲区内存（临时存储）
- **cach**：缓存内存（加速访问）
- **free**：完全空闲的内存
- **available** = free + buff + cach（实际可用内存）

### 2.3 磁盘IO监控


**🔸 磁盘监控选项**
```bash
# 磁盘读写监控
dstat -d

# 特定磁盘监控
dstat -D sda,sdb

# 磁盘IO最多的进程
dstat --top-io

# 磁盘使用率监控
dstat --disk-util
```

**📈 磁盘性能分析**
```
磁盘IO性能指标：
-dsk/total-
read  writ
 15M   8.2M

性能判断：
✅ 正常：持续读写 < 100MB/s
⚠️ 繁忙：持续读写 100-500MB/s  
❌ 瓶颈：持续读写 > 500MB/s
🔥 严重：读写延迟明显增加
```

### 2.4 网络监控


**🔸 网络流量监控**
```bash
# 网络接口监控
dstat -n

# 特定网络接口
dstat -N eth0,lo

# 网络使用最多的进程
dstat --top-net

# TCP连接监控
dstat --tcp
```

**🌐 网络监控实例**
```
网络监控输出：
-net/total-
recv  send
 1.2M  856k

网络状态分析：
recv - 接收数据速度
send - 发送数据速度

异常识别：
• 突然的高流量峰值
• 持续的单向大流量
• 网络使用与业务不匹配
```

---

## 3. ⚙️ 自定义监控模块与配置


### 3.1 监控模块组合


**🎛 基础模块组合**
```bash
# CPU + 内存 + 磁盘
dstat -cmd

# 完整系统监控
dstat -cdngy

# 参数含义：
# -c: CPU使用率
# -d: 磁盘读写  
# -n: 网络流量
# -g: 分页活动
# -y: 系统统计
```

**🔧 高级模块组合**
```bash
# 服务器性能全面监控
dstat -cdngy --top-cpu --top-mem --top-io

# 数据库服务器监控
dstat -cmd --tcp --top-mem --top-io

# Web服务器监控  
dstat -cn --tcp --top-net --top-cpu
```

### 3.2 监控频率控制


**⏱ 时间间隔设置**
```bash
# 每2秒更新一次
dstat 2

# 每5秒更新，总共监控10次
dstat 5 10

# 持续监控30分钟，每10秒一次
dstat 10 180
```

**📊 不同场景的频率建议**
```
监控场景与频率选择：
🔸 实时故障排查：1-2秒间隔
🔸 日常性能观察：5-10秒间隔  
🔸 长期趋势分析：30-60秒间隔
🔸 系统负载测试：1秒间隔
```

### 3.3 自定义监控插件


**🔌 查看可用插件**
```bash
# 查看所有可用的dstat插件
dstat --list

# 常用插件示例：
# --battery     电池状态
# --cpu-temp    CPU温度
# --fan         风扇转速  
# --mysql5      MySQL状态
# --postfix     邮件服务状态
```

**🎯 特定服务监控**
```bash
# MySQL数据库监控
dstat --mysql5-cmd --mysql5-conn --mysql5-io

# Apache Web服务器监控
dstat --apache24-req --apache24-con --apache24-work

# 系统温度监控（需要传感器支持）
dstat --cpu-temp --thermal
```

---

## 4. 🎨 彩色输出与数据可视化


### 4.1 彩色输出功能


**🌈 启用彩色显示**
```bash
# 默认彩色输出
dstat

# 强制彩色输出
dstat --color

# 禁用彩色输出
dstat --nocolor
```

**🎨 颜色含义解读**
```
dstat颜色编码规则：
🟢 绿色：正常范围，性能良好
🟡 黄色：中等使用，需要关注  
🔴 红色：高使用率，可能有问题
🔵 蓝色：特殊状态或计数器
⚪ 白色：默认数值显示
```

### 4.2 输出格式优化


**📏 输出宽度调整**
```bash
# 指定输出终端宽度
dstat --output /tmp/dstat.log

# 调整数字精度
dstat --float

# 不显示标题行
dstat --noheaders
```

**📊 数据显示优化**
```bash
# 每隔20行重复显示标题
dstat -cmd 5

# 输出示例：
#----total-cpu-usage---- -dsk/total- ------memory-usage-----
#usr sys idl wai hiq siq| read  writ| used  buff  cach  free
# 15   2  82   1   0   0|  12k   34k| 2.1G  156M  1.2G  4.5G
# 18   3  78   1   0   0|   0   128k| 2.3G  156M  1.2G  4.3G
# 每20行会重复显示标题，方便长时间监控
```

### 4.3 自定义显示格式


**🎪 个性化输出设置**
```bash
# 创建自定义配置文件
cat > ~/.dstatrc << 'EOF'
[dstat]
# 默认插件
default = "cpu,mem,net,disk"
# 更新间隔
delay = 3
# 输出格式
output-format = "csv"
EOF
```

---

## 5. 💾 监控数据导出与保存


### 5.1 数据导出基础


**📁 基本数据保存**
```bash
# 保存到文件
dstat -cdm --output /tmp/system_monitor.csv

# 同时显示和保存
dstat -cdm | tee /tmp/system_monitor.log

# 后台运行并保存
nohup dstat -cdm 10 > /tmp/dstat_$(date +%Y%m%d).log 2>&1 &
```

**📊 CSV格式导出**
```bash
# 导出CSV格式数据
dstat -cdm --output /tmp/performance.csv 5 720

# CSV文件内容示例：
# "Dstat 0.7.3 CSV output"
# "Host:","server01",,,,"User:","root"
# "Epoch","usr","sys","idl","wai","read","writ","used","buff","cach","free"
# 1694234567,15.2,2.1,81.5,1.2,12543,34221,2.1G,156M,1.2G,4.5G
```

### 5.2 长期监控数据收集


**🕒 定时监控任务**
```bash
# 创建监控脚本
cat > /usr/local/bin/system_monitor.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M)
LOG_DIR="/var/log/performance"
mkdir -p $LOG_DIR

# 每小时监控数据
dstat -cdmn --output $LOG_DIR/hourly_$DATE.csv 60 60
EOF

chmod +x /usr/local/bin/system_monitor.sh
```

**⏰ 定时任务配置**
```bash
# 添加到crontab
crontab -e

# 每小时执行监控
0 * * * * /usr/local/bin/system_monitor.sh

# 每天00:05清理旧日志（保留7天）
5 0 * * * find /var/log/performance -name "*.csv" -mtime +7 -delete
```

### 5.3 监控数据分析


**📈 数据分析示例**
```bash
# 分析CPU使用趋势
awk -F',' 'NR>3 {print $2+$3}' /tmp/performance.csv | \
    sort -n | tail -10

# 查找内存使用峰值
awk -F',' 'NR>3 {print $8}' /tmp/performance.csv | \
    sort -hr | head -5

# 网络流量统计
awk -F',' 'NR>3 {sum+=$9+$10} END {print "Total MB:", sum/1024/1024}' \
    /tmp/performance.csv
```

---

## 6. 🚨 系统瓶颈快速识别技巧


### 6.1 CPU瓶颈识别


**🔥 CPU瓶颈特征**
```bash
# 监控CPU瓶颈
dstat -c --top-cpu 2

# 瓶颈识别标准：
# ✅ 健康：总CPU使用 < 70%
# ⚠️ 繁忙：总CPU使用 70-85%  
# ❌ 瓶颈：总CPU使用 > 85%
# 🚨 严重：持续100%使用超过5分钟
```

**🔍 CPU问题诊断流程**
```
CPU瓶颈诊断步骤：
┌─────────────┐
│ 1.观察总使用率 │ → 超过85%？ → 是 → 进入下一步
└─────────────┘                ↓
┌─────────────┐                否
│ 2.检查进程分布 │ ← ← ← ← ← ← ← ← ← 
└─────────────┘
         ↓
┌─────────────┐
│ 3.分析等待时间 │ → wai>20%? → IO瓶颈
└─────────────┘        ↓
                     否 → CPU密集型负载
```

### 6.2 内存瓶颈识别


**💾 内存压力监控**
```bash
# 内存压力全面监控
dstat -m -s --top-mem 3

# 内存瓶颈识别：
# ❌ 物理内存不足：used/(used+free) > 90%
# ❌ 开始使用交换：swap used > 0
# ❌ 频繁交换：swap in/out > 0持续出现
```

**🔍 内存问题分析**
```
内存瓶颈判断流程：
物理内存使用率 > 85% ?
         ↓ 是
交换分区开始使用 ?  
         ↓ 是
系统响应变慢 ?
         ↓ 是
确认内存瓶颈，需要：
• 优化应用程序
• 增加物理内存
• 调整内存使用策略
```

### 6.3 磁盘IO瓶颈识别


**💿 磁盘IO监控**
```bash
# 磁盘IO瓶颈监控
dstat -d --disk-util --top-io 2

# IO瓶颈特征：
# ⚠️ 繁忙：持续读写 > 50MB/s
# ❌ 瓶颈：util > 90%
# 🚨 严重：await > 100ms
```

**📊 IO瓶颈快速判断**
```
磁盘IO瓶颈识别：
dstat输出分析：
-dsk/total-
read  writ
 150M  89M   ← 持续高读写

CPU等待时间：
wai: 25%     ← 高等待时间表示IO瓶颈

解决方案优先级：
1. 优化应用程序IO模式
2. 使用SSD替换机械硬盘  
3. 增加内存减少磁盘访问
4. 配置RAID提升IO性能
```

### 6.4 网络瓶颈识别


**🌐 网络性能监控**
```bash
# 网络瓶颈监控
dstat -n --tcp --top-net 2

# 网络瓶颈特征：
# ⚠️ 繁忙：持续流量接近带宽上限
# ❌ 瓶颈：丢包率增加
# 🚨 严重：连接建立失败增多
```

---

## 7. 📊 资源使用趋势观察方法


### 7.1 短期趋势观察


**⏱ 实时趋势监控**
```bash
# 5分钟内系统负载趋势
dstat -la 5 60

# 观察要点：
# • 负载是否持续上升
# • 是否有周期性变化
# • 峰值出现的时间规律
```

**📈 趋势变化识别**
```
趋势分析方法：
时间段对比：
现在vs 5分钟前 → 短期变化
现在vs 1小时前 → 中期趋势  
现在vs 1天前   → 长期趋势

变化幅度评估：
< 10%  → 稳定
10-30% → 轻微波动
30-50% → 明显变化
> 50%  → 剧烈变化
```

### 7.2 周期性模式分析


**🔄 业务周期监控**
```bash
# 工作日负载模式监控（每小时记录）
dstat -cmd --output /tmp/workday_$(date +%u).csv 3600 24

# 分析不同时段的负载特征：
# 上班时间：8:00-18:00 高负载
# 午休时间：12:00-14:00 负载下降
# 下班时间：18:00-次日8:00 低负载
```

**📅 长期趋势数据收集**
```bash
# 创建月度趋势分析脚本
cat > /usr/local/bin/monthly_trend.sh << 'EOF'
#!/bin/bash
MONTH=$(date +%Y%m)
REPORT_DIR="/var/log/performance/monthly"
mkdir -p $REPORT_DIR

# 每天的平均值统计
dstat -cmd --output $REPORT_DIR/daily_${MONTH}_$(date +%d).csv 300 288
EOF
```

### 7.3 异常模式检测


**🚨 异常检测方法**
```bash
# 建立基线数据（正常工作日）
dstat -cmd 60 > /tmp/baseline_normal.log

# 对比当前数据
dstat -cmd 60 > /tmp/current_check.log

# 简单的异常检测脚本示例
cat > /usr/local/bin/anomaly_check.sh << 'EOF'
#!/bin/bash
# 获取当前CPU使用率
CURRENT_CPU=$(dstat -c 1 1 | tail -1 | awk '{print $1+$2}')
BASELINE_CPU=30  # 基线CPU使用率

if [ $CURRENT_CPU -gt $((BASELINE_CPU * 2)) ]; then
    echo "警告：CPU使用率异常高，当前：${CURRENT_CPU}%"
    # 发送告警邮件或通知
fi
EOF
```

---

## 8. 🎯 综合性能分析实战


### 8.1 Web服务器性能分析


**🌐 Web服务器监控策略**
```bash
# Web服务器综合监控
dstat -cmdyn --tcp --top-cpu --top-net 5

# 重点关注指标：
# CPU：处理请求的计算能力
# 内存：缓存和会话数据
# 网络：请求响应流量
# TCP连接：并发连接数
```

**📊 Web负载分析实例**
```
Web服务器性能分析：
----total-cpu-usage---- ------memory-usage----- -net/total- --tcp-sockets-
usr sys idl wai hiq siq| used  buff  cach  free| recv  send|lis act syn tim 
 45   8  45   2   0   0| 6.2G  256M  2.1G  1.4G| 2.3M  1.8M| 10 245  15   2

分析结论：
✅ CPU使用率53%，处理能力充足
⚠️ 内存使用率82%，需要关注
✅ 网络流量正常，响应良好
✅ TCP连接数245，在正常范围
```

### 8.2 数据库服务器分析


**🗄 数据库性能监控**
```bash
# 数据库服务器监控
dstat -cmdg --top-mem --top-io 3

# 数据库特有监控重点：
# 内存：缓存命中率关键
# 磁盘IO：查询和事务处理
# CPU：复杂查询计算
```

**💾 数据库负载实例**
```
数据库服务器分析：
----total-cpu-usage---- ------memory-usage----- -dsk/total- --most-expensive-
usr sys idl wai hiq siq| used  buff  cach  free| read  writ|    memory process
 25   5  55  15   0   0| 14.2G 512M  4.2G  1.1G| 45M   28M| mysql     12.8G
 
分析结论：
⚠️ CPU等待时间15%，IO可能是瓶颈
❌ 内存使用率91%，接近极限
⚠️ 磁盘读写较高，需要优化查询
🔍 MySQL进程占用12.8G内存，需要调优
```

### 8.3 性能调优指导


**⚡ 基于监控数据的调优建议**
```
性能问题 → 调优方案：

CPU瓶颈：
• 优化应用程序算法
• 增加CPU核心数
• 使用负载均衡分散压力

内存瓶颈：
• 增加物理内存
• 优化内存使用效率
• 调整缓存策略

磁盘IO瓶颈：
• 使用SSD替换机械硬盘
• 优化数据库查询
• 增加内存减少磁盘访问

网络瓶颈：
• 升级网络带宽
• 优化网络配置
• 使用CDN分散流量
```

**🎯 调优效果验证**
```bash
# 调优前性能基线
dstat -cmd --output /tmp/before_tuning.csv 60 60

# 应用调优措施
# ... 执行具体的调优操作 ...

# 调优后性能对比
dstat -cmd --output /tmp/after_tuning.csv 60 60

# 对比分析脚本
cat > /usr/local/bin/compare_performance.sh << 'EOF'
#!/bin/bash
echo "调优前后性能对比："
echo "调优前平均CPU使用率："
awk -F',' 'NR>3 {sum+=$2+$3; count++} END {print sum/count "%"}' /tmp/before_tuning.csv

echo "调优后平均CPU使用率："  
awk -F',' 'NR>3 {sum+=$2+$3; count++} END {print sum/count "%"}' /tmp/after_tuning.csv
EOF
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 dstat本质：综合性实时系统监控工具
🔸 多维监控：CPU、内存、磁盘、网络统一视图
🔸 模块化设计：可按需选择监控项目
🔸 实时性强：动态显示系统状态变化
🔸 数据导出：支持CSV格式长期数据分析
```

### 9.2 关键理解要点


**🔹 监控的意义**
```
系统监控 = 健康体检
• 及时发现问题，预防故障
• 了解系统负载，合理规划
• 优化性能，提升用户体验
• 数据支撑，科学决策
```

**🔹 瓶颈识别的思路**
```
瓶颈识别流程：
1. 观察整体负载情况
2. 确定瓶颈资源类型  
3. 分析瓶颈产生原因
4. 制定针对性解决方案
5. 实施并验证效果
```

**🔹 数据分析的价值**
```
监控数据的作用：
• 建立性能基线标准
• 发现性能变化趋势
• 预测容量规划需求
• 支持故障根因分析
```

### 9.3 实际应用价值


- **故障诊断**：快速定位系统性能问题根源
- **容量规划**：基于历史数据预测资源需求
- **性能优化**：找到系统瓶颈并制定优化策略
- **趋势分析**：了解系统负载的周期性变化规律
- **告警监控**：建立基线并设置异常告警机制

### 9.4 学习进阶路径


```
🎯 掌握层次：
入门：能使用基本命令监控系统状态
进阶：掌握自定义监控和数据导出
高级：能分析性能瓶颈并制定优化方案
专家：能建立完整的监控体系和告警机制

📚 扩展学习：
• 学习Prometheus+Grafana监控体系
• 掌握ELK日志分析平台
• 了解APM应用性能监控工具
• 研究云原生监控解决方案
```

**💡 实践建议**
- 建立日常监控习惯，熟悉正常系统状态
- 在不同负载场景下观察系统表现
- 收集和分析历史监控数据
- 结合业务场景制定监控策略

**🧠 记忆技巧**
```
dstat参数记忆口诀：
-c CPU处理器，-d 磁盘读写忙
-m 内存使用量，-n 网络流量强  
-g 分页交换数，-y 系统统计详
组合使用灵活配，系统监控全覆盖
```

**核心记忆**：
- dstat是综合性系统监控的瑞士军刀
- 实时多维度监控，一个工具解决多种需求
- 彩色输出直观友好，数据导出便于分析
- 掌握瓶颈识别方法，快速定位性能问题