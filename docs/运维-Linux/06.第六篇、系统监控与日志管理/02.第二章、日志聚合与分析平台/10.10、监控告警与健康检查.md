---
title: 10ã€ç›‘æ§å‘Šè­¦ä¸å¥åº·æ£€æŸ¥
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤çŠ¶æ€ç›‘æ§æŒ‡æ ‡](#1-é›†ç¾¤çŠ¶æ€ç›‘æ§æŒ‡æ ‡)
2. [Watcherå‘Šè­¦è§„åˆ™é…ç½®](#2-Watcherå‘Šè­¦è§„åˆ™é…ç½®)
3. [é‚®ä»¶ä¸Slackå‘Šè­¦é€šçŸ¥](#3-é‚®ä»¶ä¸Slackå‘Šè­¦é€šçŸ¥)
4. [æ€§èƒ½æŒ‡æ ‡é˜ˆå€¼è®¾ç½®](#4-æ€§èƒ½æŒ‡æ ‡é˜ˆå€¼è®¾ç½®)
5. [ç£ç›˜ç©ºé—´ç›‘æ§å‘Šè­¦](#5-ç£ç›˜ç©ºé—´ç›‘æ§å‘Šè­¦)
6. [æŸ¥è¯¢æ€§èƒ½ç›‘æ§](#6-æŸ¥è¯¢æ€§èƒ½ç›‘æ§)
7. [é›†ç¾¤æ•…éšœè‡ªåŠ¨æ¢å¤](#7-é›†ç¾¤æ•…éšœè‡ªåŠ¨æ¢å¤)
8. [ç›‘æ§æ•°æ®å¯è§†åŒ–å±•ç¤º](#8-ç›‘æ§æ•°æ®å¯è§†åŒ–å±•ç¤º)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“Š é›†ç¾¤çŠ¶æ€ç›‘æ§æŒ‡æ ‡


### 1.1 ä»€ä¹ˆæ˜¯é›†ç¾¤çŠ¶æ€ç›‘æ§


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> é›†ç¾¤çŠ¶æ€ç›‘æ§å°±åƒç»™ELKé›†ç¾¤åš"ä½“æ£€"ï¼Œé€šè¿‡å„ç§æŒ‡æ ‡æ¥åˆ¤æ–­é›†ç¾¤æ˜¯å¦å¥åº·è¿è¡Œã€‚å°±åƒåŒ»ç”Ÿé€šè¿‡è¡€å‹ã€å¿ƒç‡æ¥åˆ¤æ–­ç—…äººå¥åº·çŠ¶å†µä¸€æ ·ã€‚

**ğŸ” ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Ÿ**
```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
åŒ»é™¢ä½“æ£€ â†’ ELKé›†ç¾¤ç›‘æ§
è¡€å‹å¿ƒç‡ â†’ CPUå†…å­˜ä½¿ç”¨ç‡
åŒ–éªŒæŠ¥å‘Š â†’ é›†ç¾¤å¥åº·çŠ¶æ€
åŒ»ç”Ÿè¯Šæ–­ â†’ å‘Šè­¦ç³»ç»Ÿåˆ¤æ–­
```

### 1.2 æ ¸å¿ƒç›‘æ§æŒ‡æ ‡è¯¦è§£


**ğŸŸ¢ é›†ç¾¤æ•´ä½“çŠ¶æ€**
```bash
# æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶æ€
curl -X GET "localhost:9200/_cluster/health?pretty"

# è¿”å›ç»“æœå«ä¹‰ï¼š
{
  "status": "green",        # ç»¿è‰²=å¥åº·ï¼Œé»„è‰²=è­¦å‘Šï¼Œçº¢è‰²=æ•…éšœ
  "number_of_nodes": 3,     # èŠ‚ç‚¹æ•°é‡
  "active_primary_shards": 15,   # æ´»è·ƒä¸»åˆ†ç‰‡æ•°
  "active_shards": 30,      # æ´»è·ƒåˆ†ç‰‡æ€»æ•°
  "unassigned_shards": 0    # æœªåˆ†é…åˆ†ç‰‡æ•°ï¼ˆåº”è¯¥ä¸º0ï¼‰
}
```

> **ğŸ“Œ çŠ¶æ€é¢œè‰²è§£è¯»**
> - ğŸŸ¢ **Greenï¼ˆç»¿è‰²ï¼‰**ï¼šæ‰€æœ‰åˆ†ç‰‡éƒ½æ­£å¸¸ï¼Œé›†ç¾¤å®Œå…¨å¥åº·
> - ğŸŸ¡ **Yellowï¼ˆé»„è‰²ï¼‰**ï¼šä¸»åˆ†ç‰‡æ­£å¸¸ï¼Œä½†æœ‰å‰¯æœ¬åˆ†ç‰‡ç¼ºå¤±
> - ğŸ”´ **Redï¼ˆçº¢è‰²ï¼‰**ï¼šæœ‰ä¸»åˆ†ç‰‡ç¼ºå¤±ï¼Œæ•°æ®å¯èƒ½ä¸¢å¤±

**ğŸ“ˆ èŠ‚ç‚¹èµ„æºç›‘æ§**
```bash
# æŸ¥çœ‹èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯
curl -X GET "localhost:9200/_nodes/stats?pretty"

# é‡ç‚¹å…³æ³¨æŒ‡æ ‡ï¼š
```
CPUä½¿ç”¨ç‡     â†’ åº”è¯¥ < 80%
å†…å­˜ä½¿ç”¨ç‡   â†’ åº”è¯¥ < 85%
ç£ç›˜ä½¿ç”¨ç‡   â†’ åº”è¯¥ < 80%
JVMå †å†…å­˜    â†’ åº”è¯¥ < 75%
```
```

**ğŸ”„ åˆ†ç‰‡çŠ¶æ€ç›‘æ§**
```bash
# æŸ¥çœ‹åˆ†ç‰‡åˆ†é…æƒ…å†µ
curl -X GET "localhost:9200/_cat/shards?v"

# å…³æ³¨æŒ‡æ ‡ï¼š
```
æœªåˆ†é…åˆ†ç‰‡æ•°é‡    â†’ åº”è¯¥ä¸º 0
åˆ†ç‰‡å¤§å°åˆ†å¸ƒ     â†’ åº”è¯¥ç›¸å¯¹å‡åŒ€
åˆ†ç‰‡é‡å®šä½æƒ…å†µ   â†’ é¢‘ç¹é‡å®šä½è¯´æ˜æœ‰é—®é¢˜
```
```

### 1.3 ç›‘æ§æŒ‡æ ‡é˜ˆå€¼å»ºè®®


| æŒ‡æ ‡ç±»å‹ | **æ­£å¸¸èŒƒå›´** | **è­¦å‘Šé˜ˆå€¼** | **ç´§æ€¥é˜ˆå€¼** | **è¯´æ˜** |
|---------|-------------|-------------|-------------|----------|
| ğŸ–¥ï¸ **CPUä½¿ç”¨ç‡** | `< 70%` | `70-85%` | `> 85%` | `æŒç»­é«˜CPUå½±å“å“åº”` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨ç‡** | `< 75%` | `75-90%` | `> 90%` | `å†…å­˜ä¸è¶³å¯¼è‡´OOM` |
| ğŸ’¿ **ç£ç›˜ä½¿ç”¨ç‡** | `< 80%` | `80-90%` | `> 90%` | `ç£ç›˜æ»¡ä¼šåœæ­¢å†™å…¥` |
| â˜• **JVMå †å†…å­˜** | `< 70%` | `70-85%` | `> 85%` | `å †å†…å­˜ä¸è¶³å½±å“GC` |
| ğŸ” **æŸ¥è¯¢å»¶è¿Ÿ** | `< 100ms` | `100-500ms` | `> 500ms` | `ç”¨æˆ·ä½“éªŒä¸‹é™` |

---

## 2. âš¡ Watcherå‘Šè­¦è§„åˆ™é…ç½®


### 2.1 ä»€ä¹ˆæ˜¯Watcher


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> Watcherå°±åƒä¸€ä¸ª"æ™ºèƒ½ä¿å®‰"ï¼Œ24å°æ—¶ä¸é—´æ–­åœ°ç›‘æ§ELKé›†ç¾¤ï¼Œä¸€æ—¦å‘ç°å¼‚å¸¸å°±ç«‹å³é€šçŸ¥ç®¡ç†å‘˜ã€‚å®ƒä¼šæŒ‰ç…§ä½ è®¾å®šçš„è§„åˆ™è‡ªåŠ¨æ£€æŸ¥å„ç§æŒ‡æ ‡ã€‚

**ğŸ”§ Watcherå·¥ä½œåŸç†**
```
ç›‘æ§æµç¨‹ï¼š
æ•°æ®æ”¶é›† â†’ æ¡ä»¶åˆ¤æ–­ â†’ è§¦å‘å‘Šè­¦ â†’ å‘é€é€šçŸ¥
   â†“         â†“         â†“         â†“
é‡‡é›†æŒ‡æ ‡   è§„åˆ™åŒ¹é…   å‘Šè­¦è§¦å‘   é‚®ä»¶/çŸ­ä¿¡
```

### 2.2 åŸºç¡€Watcheré…ç½®


**ğŸ“ åˆ›å»ºç®€å•çš„CPUç›‘æ§è§„åˆ™**
```json
PUT _watcher/watch/cpu_monitor
{
  "trigger": {
    "schedule": {
      "interval": "30s"     # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [".monitoring-es-*"],
        "body": {
          "query": {
            "bool": {
              "must": [
                {
                  "range": {
                    "timestamp": {
                      "gte": "now-1m"    # æ£€æŸ¥æœ€è¿‘1åˆ†é’Ÿçš„æ•°æ®
                    }
                  }
                }
              ]
            }
          },
          "aggs": {
            "avg_cpu": {
              "avg": {
                "field": "node_stats.process.cpu.percent"
              }
            }
          }
        }
      }
    }
  },
  "condition": {
    "compare": {
      "ctx.payload.aggregations.avg_cpu.value": {
        "gte": 80    # CPUä½¿ç”¨ç‡ >= 80% æ—¶è§¦å‘
      }
    }
  },
  "actions": {
    "send_email": {
      "email": {
        "to": ["admin@company.com"],
        "subject": "ELKé›†ç¾¤CPUä½¿ç”¨ç‡å‘Šè­¦",
        "body": "CPUä½¿ç”¨ç‡å·²è¾¾åˆ° {{ctx.payload.aggregations.avg_cpu.value}}%"
      }
    }
  }
}
```

> **ğŸ” é…ç½®è§£è¯»**
> - `trigger`ï¼šä»€ä¹ˆæ—¶å€™æ£€æŸ¥ï¼ˆæ¯30ç§’ï¼‰
> - `input`ï¼šæ£€æŸ¥ä»€ä¹ˆæ•°æ®ï¼ˆCPUä½¿ç”¨ç‡ï¼‰
> - `condition`ï¼šä»€ä¹ˆæƒ…å†µä¸‹å‘Šè­¦ï¼ˆCPUâ‰¥80%ï¼‰
> - `actions`ï¼šå¦‚ä½•é€šçŸ¥ï¼ˆå‘é‚®ä»¶ï¼‰

### 2.3 é«˜çº§Watcherè§„åˆ™


**ğŸš¨ ç£ç›˜ç©ºé—´å‘Šè­¦è§„åˆ™**
```json
PUT _watcher/watch/disk_space_monitor
{
  "trigger": {
    "schedule": {
      "interval": "5m"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [".monitoring-es-*"],
        "body": {
          "query": {
            "range": {
              "timestamp": {
                "gte": "now-5m"
              }
            }
          },
          "aggs": {
            "nodes": {
              "terms": {
                "field": "source_node.name"
              },
              "aggs": {
                "disk_usage": {
                  "avg": {
                    "script": {
                      "source": """
                        def total = doc['node_stats.fs.total.total_in_bytes'].value;
                        def free = doc['node_stats.fs.total.free_in_bytes'].value;
                        return ((total - free) / total) * 100;
                      """
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "condition": {
    "script": {
      "source": """
        for (bucket in ctx.payload.aggregations.nodes.buckets) {
          if (bucket.disk_usage.value > 85) {
            return true;
          }
        }
        return false;
      """
    }
  },
  "actions": {
    "send_slack": {
      "webhook": {
        "scheme": "https",
        "host": "hooks.slack.com",
        "port": 443,
        "method": "post",
        "path": "/services/YOUR/SLACK/WEBHOOK",
        "body": """
        {
          "text": "ğŸš¨ ELKé›†ç¾¤ç£ç›˜ç©ºé—´å‘Šè­¦",
          "attachments": [
            {
              "color": "danger",
              "text": "æœ‰èŠ‚ç‚¹ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡85%ï¼Œè¯·åŠæ—¶å¤„ç†ï¼"
            }
          ]
        }
        """
      }
    }
  }
}
```

---

## 3. ğŸ“§ é‚®ä»¶ä¸Slackå‘Šè­¦é€šçŸ¥


### 3.1 é‚®ä»¶é€šçŸ¥é…ç½®


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> é‚®ä»¶é€šçŸ¥å°±åƒä¼ ç»Ÿçš„"æŠ¥è­¦å™¨"ï¼Œå½“ç³»ç»Ÿå‡ºé—®é¢˜æ—¶è‡ªåŠ¨å‘é‚®ä»¶ç»™ç®¡ç†å‘˜ã€‚éœ€è¦å…ˆé…ç½®å¥½"é‚®å±€"ï¼ˆSMTPæœåŠ¡å™¨ï¼‰ï¼Œç„¶åå‘Šè¯‰ç³»ç»Ÿå¾€å“ªé‡Œå‘é‚®ä»¶ã€‚

**ğŸ”§ é…ç½®SMTPæœåŠ¡å™¨**
```yaml
# åœ¨ elasticsearch.yml ä¸­é…ç½®
xpack.notification.email:
  account:
    work:
      profile: standard
      email_defaults:
        from: noreply@company.com    # å‘ä»¶äººé‚®ç®±
      smtp:
        auth: true
        starttls.enable: true
        host: smtp.gmail.com         # SMTPæœåŠ¡å™¨
        port: 587
        user: noreply@company.com    # ç”¨æˆ·å
        password: your_password      # å¯†ç 
```

**ğŸ“¨ é‚®ä»¶æ¨¡æ¿é…ç½®**
```json
{
  "actions": {
    "send_email": {
      "email": {
        "profile": "standard",
        "account": "work",
        "to": [
          "admin@company.com",
          "devops@company.com"
        ],
        "cc": ["manager@company.com"],    # æŠ„é€
        "subject": "ğŸš¨ ELKé›†ç¾¤å‘Šè­¦ - {{ctx.watch_id}}",
        "body": {
          "html": """
            <h2>ELKé›†ç¾¤å‘Šè­¦é€šçŸ¥</h2>
            <p><strong>å‘Šè­¦æ—¶é—´ï¼š</strong> {{ctx.execution_time}}</p>
            <p><strong>å‘Šè­¦ç±»å‹ï¼š</strong> {{ctx.watch_id}}</p>
            <p><strong>å‘Šè­¦è¯¦æƒ…ï¼š</strong></p>
            <ul>
              <li>CPUä½¿ç”¨ç‡ï¼š{{ctx.payload.aggregations.avg_cpu.value}}%</li>
              <li>å†…å­˜ä½¿ç”¨ç‡ï¼š{{ctx.payload.aggregations.avg_memory.value}}%</li>
            </ul>
            <p>è¯·åŠæ—¶å¤„ç†ï¼</p>
          """
        },
        "attachments": [
          {
            "type": "data",
            "format": "json",
            "data": {
              "format": "json"
            }
          }
        ]
      }
    }
  }
}
```

### 3.2 Slacké›†æˆé…ç½®


**ğŸ”” Slack Webhooké…ç½®**
```bash
# 1. åœ¨Slackä¸­åˆ›å»ºIncoming Webhook
# 2. è·å–Webhook URL
# 3. åœ¨Watcherä¸­é…ç½®
```

```json
{
  "actions": {
    "notify_slack": {
      "webhook": {
        "scheme": "https",
        "host": "hooks.slack.com",
        "port": 443,
        "method": "post",
        "path": "/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": """
        {
          "channel": "#ops-alerts",
          "username": "ELK-Monitor",
          "icon_emoji": ":warning:",
          "text": "ELKé›†ç¾¤å‘Šè­¦",
          "attachments": [
            {
              "color": "{{#compare ctx.payload.aggregations.avg_cpu.value gte 90}}danger{{else}}warning{{/compare}}",
              "title": "é›†ç¾¤æ€§èƒ½å‘Šè­¦",
              "fields": [
                {
                  "title": "CPUä½¿ç”¨ç‡",
                  "value": "{{ctx.payload.aggregations.avg_cpu.value}}%",
                  "short": true
                },
                {
                  "title": "å‘Šè­¦æ—¶é—´",
                  "value": "{{ctx.execution_time}}",
                  "short": true
                }
              ],
              "footer": "ELKç›‘æ§ç³»ç»Ÿ",
              "ts": {{ctx.execution_time.millis}}
            }
          ]
        }
        """
      }
    }
  }
}
```

### 3.3 å¤šçº§å‘Šè­¦é€šçŸ¥


**ğŸ“¢ æ ¹æ®ä¸¥é‡ç¨‹åº¦åˆ†çº§é€šçŸ¥**
```json
{
  "actions": {
    "notify_warning": {
      "condition": {
        "compare": {
          "ctx.payload.aggregations.avg_cpu.value": {
            "gte": 70,
            "lt": 85
          }
        }
      },
      "email": {
        "to": ["devops@company.com"],
        "subject": "âš ï¸ ELKé›†ç¾¤æ€§èƒ½è­¦å‘Š"
      }
    },
    "notify_critical": {
      "condition": {
        "compare": {
          "ctx.payload.aggregations.avg_cpu.value": {
            "gte": 85
          }
        }
      },
      "email": {
        "to": [
          "devops@company.com",
          "admin@company.com",
          "manager@company.com"
        ],
        "subject": "ğŸš¨ ELKé›†ç¾¤ä¸¥é‡å‘Šè­¦"
      }
    }
  }
}
```

---

## 4. ğŸ“ æ€§èƒ½æŒ‡æ ‡é˜ˆå€¼è®¾ç½®


### 4.1 ç†è§£æ€§èƒ½é˜ˆå€¼


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> æ€§èƒ½é˜ˆå€¼å°±åƒæ±½è½¦çš„"ä»ªè¡¨ç›˜çº¢çº¿"ï¼Œå½“æŒ‡é’ˆæ¥è¿‘çº¢çº¿æ—¶å°±è¦å°å¿ƒäº†ã€‚ä¸åŒçš„æŒ‡æ ‡æœ‰ä¸åŒçš„"å±é™©çº¿"ï¼Œè¶…è¿‡äº†å°±å¯èƒ½å‡ºé—®é¢˜ã€‚

**ğŸ¯ é˜ˆå€¼è®¾ç½®åŸåˆ™**
```
é˜ˆå€¼è®¾ç½®ä¸‰åŸåˆ™ï¼š
1. åŸºäºå†å²æ•°æ® â†’ åˆ†æå¹³æ—¶çš„æ­£å¸¸èŒƒå›´
2. è€ƒè™‘ä¸šåŠ¡ç‰¹ç‚¹ â†’ é«˜å³°æœŸvså¹³æ—¶çš„ä¸åŒæ ‡å‡†
3. é¢„ç•™å®‰å…¨ä½™é‡ â†’ ä¸è¦ç­‰åˆ°100%æ‰å‘Šè­¦
```

### 4.2 å„ç±»æŒ‡æ ‡é˜ˆå€¼è¯¦è§£


**ğŸ–¥ï¸ CPUæ€§èƒ½é˜ˆå€¼**
```yaml
CPUç›‘æ§é…ç½®ï¼š
  # æ­£å¸¸è¿è¡Œé˜ˆå€¼
  normal_threshold: 70%
  
  # è­¦å‘Šé˜ˆå€¼ï¼ˆå¼€å§‹å…³æ³¨ï¼‰
  warning_threshold: 80%
  
  # ä¸¥é‡é˜ˆå€¼ï¼ˆç«‹å³å¤„ç†ï¼‰
  critical_threshold: 90%
  
  # æ£€æŸ¥é¢‘ç‡
  check_interval: 30s
  
  # æŒç»­æ—¶é—´ï¼ˆé¿å…ç¬é—´å³°å€¼è¯¯æŠ¥ï¼‰
  duration: 2m
```

**ç¤ºä¾‹é…ç½®ï¼š**
```json
{
  "condition": {
    "script": {
      "source": """
        // æ£€æŸ¥æœ€è¿‘2åˆ†é’Ÿçš„å¹³å‡CPU
        def recent_cpu = ctx.payload.aggregations.avg_cpu_2m.value;
        
        if (recent_cpu >= 90) {
          ctx.vars.alert_level = 'critical';
          return true;
        } else if (recent_cpu >= 80) {
          ctx.vars.alert_level = 'warning';
          return true;
        }
        return false;
      """
    }
  }
}
```

**ğŸ’¾ å†…å­˜æ€§èƒ½é˜ˆå€¼**
```
å†…å­˜ç›‘æ§é‡ç‚¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JVMå †å†…å­˜ä½¿ç”¨ç‡                 â”‚
â”‚ â”œâ”€ æ­£å¸¸ï¼š< 70%                  â”‚
â”‚ â”œâ”€ è­¦å‘Šï¼š70-85%                 â”‚
â”‚ â””â”€ ä¸¥é‡ï¼š> 85%                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡                  â”‚
â”‚ â”œâ”€ æ­£å¸¸ï¼š< 80%                  â”‚
â”‚ â”œâ”€ è­¦å‘Šï¼š80-90%                 â”‚
â”‚ â””â”€ ä¸¥é‡ï¼š> 90%                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GCé¢‘ç‡                          â”‚
â”‚ â”œâ”€ æ­£å¸¸ï¼š< æ¯åˆ†é’Ÿ5æ¬¡            â”‚
â”‚ â”œâ”€ è­¦å‘Šï¼š5-10æ¬¡/åˆ†é’Ÿ            â”‚
â”‚ â””â”€ ä¸¥é‡ï¼š> 10æ¬¡/åˆ†é’Ÿ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 åŠ¨æ€é˜ˆå€¼è°ƒæ•´


**ğŸ“Š åŸºäºå†å²æ•°æ®çš„æ™ºèƒ½é˜ˆå€¼**
```json
{
  "input": {
    "search": {
      "request": {
        "body": {
          "aggs": {
            "historical_avg": {
              "date_histogram": {
                "field": "timestamp",
                "interval": "1h"
              },
              "aggs": {
                "avg_cpu": {
                  "avg": {
                    "field": "node_stats.process.cpu.percent"
                  }
                }
              }
            },
            "baseline": {
              "avg_bucket": {
                "buckets_path": "historical_avg>avg_cpu"
              }
            },
            "current_cpu": {
              "filter": {
                "range": {
                  "timestamp": {
                    "gte": "now-5m"
                  }
                }
              },
              "aggs": {
                "avg_cpu": {
                  "avg": {
                    "field": "node_stats.process.cpu.percent"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "condition": {
    "script": {
      "source": """
        // åŠ¨æ€é˜ˆå€¼ = å†å²å¹³å‡å€¼ + 20%
        def baseline = ctx.payload.aggregations.baseline.value;
        def current = ctx.payload.aggregations.current_cpu.avg_cpu.value;
        def dynamic_threshold = baseline * 1.2;
        
        return current > dynamic_threshold;
      """
    }
  }
}
```

---

## 5. ğŸ’¿ ç£ç›˜ç©ºé—´ç›‘æ§å‘Šè­¦


### 5.1 ç£ç›˜ç›‘æ§çš„é‡è¦æ€§


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> ç£ç›˜ç©ºé—´ç›‘æ§å°±åƒç›‘æ§"ç²®ä»“"ï¼Œç²®é£Ÿï¼ˆç£ç›˜ç©ºé—´ï¼‰ä¸å¤Ÿäº†ï¼Œæ•´ä¸ª"æ‘åº„"ï¼ˆELKé›†ç¾¤ï¼‰å°±ä¼šåœæ­¢è¿è½¬ã€‚ç£ç›˜æ»¡äº†ï¼ŒElasticsearchå°±æ— æ³•å†™å…¥æ–°æ•°æ®ã€‚

> **âš ï¸ å¸¸è§è¯¯åŒº**
> å¾ˆå¤šäººä»¥ä¸ºç£ç›˜90%æ»¡æ‰éœ€è¦æ‹…å¿ƒï¼Œå®é™…ä¸ŠElasticsearchåœ¨ç£ç›˜85%æ»¡æ—¶å°±ä¼šåœæ­¢åˆ†é…æ–°åˆ†ç‰‡ï¼Œ95%æ»¡æ—¶ä¼šåœæ­¢å†™å…¥ï¼

### 5.2 ç£ç›˜ç›‘æ§é…ç½®


**ğŸ“Š ç£ç›˜ä½¿ç”¨ç‡ç›‘æ§**
```json
PUT _watcher/watch/disk_space_alert
{
  "trigger": {
    "schedule": {
      "interval": "2m"    # æ¯2åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [".monitoring-es-*"],
        "body": {
          "size": 0,
          "query": {
            "bool": {
              "must": [
                {
                  "range": {
                    "timestamp": {
                      "gte": "now-5m"
                    }
                  }
                },
                {
                  "term": {
                    "type": "node_stats"
                  }
                }
              ]
            }
          },
          "aggs": {
            "nodes": {
              "terms": {
                "field": "source_node.name",
                "size": 100
              },
              "aggs": {
                "latest": {
                  "top_hits": {
                    "sort": [{"timestamp": {"order": "desc"}}],
                    "size": 1,
                    "_source": [
                      "node_stats.fs.total.total_in_bytes",
                      "node_stats.fs.total.free_in_bytes"
                    ]
                  }
                },
                "disk_usage_percent": {
                  "bucket_script": {
                    "buckets_path": {
                      "latest": "latest"
                    },
                    "script": {
                      "source": """
                        def hit = params.latest.hits.hits[0]._source.node_stats.fs.total;
                        def total = hit.total_in_bytes;
                        def free = hit.free_in_bytes;
                        return ((total - free) / total) * 100;
                      """
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "condition": {
    "script": {
      "source": """
        // æ£€æŸ¥æ˜¯å¦æœ‰èŠ‚ç‚¹ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼
        for (bucket in ctx.payload.aggregations.nodes.buckets) {
          def usage = bucket.disk_usage_percent.value;
          if (usage > 80) {
            ctx.vars.alert_nodes = ctx.vars.alert_nodes ?: [];
            ctx.vars.alert_nodes.add([
              'node': bucket.key,
              'usage': usage
            ]);
          }
        }
        return ctx.vars.alert_nodes != null && ctx.vars.alert_nodes.size() > 0;
      """
    }
  },
  "actions": {
    "send_alert": {
      "email": {
        "to": ["admin@company.com"],
        "subject": "ğŸš¨ ELKé›†ç¾¤ç£ç›˜ç©ºé—´å‘Šè­¦",
        "body": """
          ä»¥ä¸‹èŠ‚ç‚¹ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡80%ï¼š
          
          {{#ctx.vars.alert_nodes}}
          - èŠ‚ç‚¹ï¼š{{node}}ï¼Œä½¿ç”¨ç‡ï¼š{{usage}}%
          {{/ctx.vars.alert_nodes}}
          
          è¯·åŠæ—¶æ¸…ç†æˆ–æ‰©å®¹ï¼
        """
      }
    }
  }
}
```

### 5.3 ç£ç›˜æ¸…ç†è‡ªåŠ¨åŒ–


**ğŸ§¹ è‡ªåŠ¨æ¸…ç†ç­–ç•¥**
```json
{
  "actions": {
    "auto_cleanup": {
      "condition": {
        "script": {
          "source": """
            // åªæœ‰å½“ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡90%æ—¶æ‰è‡ªåŠ¨æ¸…ç†
            for (node in ctx.vars.alert_nodes) {
              if (node.usage > 90) {
                return true;
              }
            }
            return false;
          """
        }
      },
      "webhook": {
        "scheme": "http",
        "host": "cleanup-service.local",
        "port": 8080,
        "method": "post",
        "path": "/api/cleanup",
        "body": """
        {
          "action": "delete_old_indices",
          "criteria": {
            "age": "30d",
            "pattern": "logs-*"
          }
        }
        """
      }
    },
    "manual_intervention": {
      "condition": {
        "script": {
          "source": """
            // è¶…è¿‡95%éœ€è¦äººå·¥å¹²é¢„
            for (node in ctx.vars.alert_nodes) {
              if (node.usage > 95) {
                return true;
              }
            }
            return false;
          """
        }
      },
      "email": {
        "to": ["emergency@company.com"],
        "priority": "high",
        "subject": "ğŸš¨ğŸš¨ ç´§æ€¥ï¼šELKé›†ç¾¤ç£ç›˜ç©ºé—´ä¸¥é‡ä¸è¶³",
        "body": "ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡95%ï¼Œç³»ç»Ÿå³å°†åœæ­¢å†™å…¥ï¼Œéœ€è¦ç«‹å³äººå·¥å¤„ç†ï¼"
      }
    }
  }
}
```

---

## 6. âš¡ æŸ¥è¯¢æ€§èƒ½ç›‘æ§


### 6.1 æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡è§£æ


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> æŸ¥è¯¢æ€§èƒ½ç›‘æ§å°±åƒç›‘æ§"é¤å…æœåŠ¡é€Ÿåº¦"ï¼Œå¦‚æœå®¢äººç‚¹èœåç­‰å¤ªä¹…ï¼ˆæŸ¥è¯¢å“åº”æ…¢ï¼‰ï¼Œå®¢äººå°±ä¼šä¸æ»¡æ„ç¦»å¼€ï¼ˆç”¨æˆ·ä½“éªŒå·®ï¼‰ã€‚

**ğŸ” å…³é”®æ€§èƒ½æŒ‡æ ‡**
```
æŸ¥è¯¢æ€§èƒ½é‡‘å­—å¡”ï¼š
      ğŸ”¥ å“åº”æ—¶é—´ï¼ˆæœ€é‡è¦ï¼‰
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ â† 95thç™¾åˆ†ä½å»¶è¿Ÿ    â”‚
    â”Œâ”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”
    â”‚ â† å¹³å‡æŸ¥è¯¢æ—¶é—´        â”‚
   â”Œâ”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”
   â”‚ â† æŸ¥è¯¢ååé‡ï¼ˆQPSï¼‰     â”‚
  â”Œâ”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”
  â”‚ â† æ…¢æŸ¥è¯¢æ•°é‡             â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æŸ¥è¯¢æ€§èƒ½ç›‘æ§é…ç½®


**â±ï¸ å“åº”æ—¶é—´ç›‘æ§**
```json
PUT _watcher/watch/query_performance_monitor
{
  "trigger": {
    "schedule": {
      "interval": "1m"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [".monitoring-es-*"],
        "body": {
          "size": 0,
          "query": {
            "bool": {
              "must": [
                {
                  "range": {
                    "timestamp": {
                      "gte": "now-5m"
                    }
                  }
                },
                {
                  "term": {
                    "type": "indices_stats"
                  }
                }
              ]
            }
          },
          "aggs": {
            "avg_query_time": {
              "avg": {
                "field": "indices_stats.total.search.query_time_in_millis"
              }
            },
            "total_queries": {
              "sum": {
                "field": "indices_stats.total.search.query_total"
              }
            },
            "query_rate": {
              "rate": {
                "field": "indices_stats.total.search.query_total"
              }
            }
          }
        }
      }
    }
  },
  "condition": {
    "script": {
      "source": """
        def avg_time = ctx.payload.aggregations.avg_query_time.value;
        def query_rate = ctx.payload.aggregations.query_rate.value;
        
        // å¹³å‡æŸ¥è¯¢æ—¶é—´è¶…è¿‡500ms æˆ– æŸ¥è¯¢ç‡å¼‚å¸¸ä½
        if (avg_time > 500 || query_rate < 10) {
          ctx.vars.performance_issue = true;
          ctx.vars.avg_query_time = avg_time;
          ctx.vars.query_rate = query_rate;
          return true;
        }
        return false;
      """
    }
  },
  "actions": {
    "performance_alert": {
      "email": {
        "to": ["devops@company.com"],
        "subject": "âš ï¸ ELKæŸ¥è¯¢æ€§èƒ½å‘Šè­¦",
        "body": """
          æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡å¼‚å¸¸ï¼š
          
          å¹³å‡æŸ¥è¯¢æ—¶é—´ï¼š{{ctx.vars.avg_query_time}} ms
          æŸ¥è¯¢é€Ÿç‡ï¼š{{ctx.vars.query_rate}} queries/sec
          
          å»ºè®®æ£€æŸ¥ï¼š
          1. æ˜¯å¦æœ‰æ…¢æŸ¥è¯¢
          2. ç´¢å¼•æ˜¯å¦éœ€è¦ä¼˜åŒ–
          3. é›†ç¾¤èµ„æºæ˜¯å¦å……è¶³
        """
      }
    }
  }
}
```

### 6.3 æ…¢æŸ¥è¯¢æ£€æµ‹


**ğŸŒ æ…¢æŸ¥è¯¢ç›‘æ§é…ç½®**
```json
PUT _watcher/watch/slow_query_detector
{
  "trigger": {
    "schedule": {
      "interval": "30s"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": ["slow-query-logs-*"],
        "body": {
          "size": 10,
          "query": {
            "bool": {
              "must": [
                {
                  "range": {
                    "timestamp": {
                      "gte": "now-1m"
                    }
                  }
                },
                {
                  "range": {
                    "took_millis": {
                      "gte": 1000    # æŸ¥è¯¢æ—¶é—´è¶…è¿‡1ç§’
                    }
                  }
                }
              ]
            }
          },
          "sort": [
            {
              "took_millis": {
                "order": "desc"
              }
            }
          ]
        }
      }
    }
  },
  "condition": {
    "compare": {
      "ctx.payload.hits.total": {
        "gt": 0
      }
    }
  },
  "actions": {
    "slow_query_alert": {
      "email": {
        "to": ["performance-team@company.com"],
        "subject": "ğŸŒ å‘ç°æ…¢æŸ¥è¯¢",
        "body": """
          åœ¨è¿‡å»1åˆ†é’Ÿå†…å‘ç° {{ctx.payload.hits.total}} ä¸ªæ…¢æŸ¥è¯¢ï¼š
          
          {{#ctx.payload.hits.hits}}
          æŸ¥è¯¢æ—¶é—´ï¼š{{_source.took_millis}}ms
          ç´¢å¼•ï¼š{{_source.index}}
          æŸ¥è¯¢å†…å®¹ï¼š{{_source.query}}
          ---
          {{/ctx.payload.hits.hits}}
        """
      }
    }
  }
}
```

---

## 7. ğŸ”„ é›†ç¾¤æ•…éšœè‡ªåŠ¨æ¢å¤


### 7.1 è‡ªåŠ¨æ¢å¤æœºåˆ¶åŸç†


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> è‡ªåŠ¨æ¢å¤å°±åƒ"æ™ºèƒ½åŒ»ç–—ç³»ç»Ÿ"ï¼Œå½“æ£€æµ‹åˆ°é—®é¢˜æ—¶ä¸ä»…å‘Šè­¦ï¼Œè¿˜ä¼šå°è¯•è‡ªåŠ¨"æ²»ç–—"ã€‚å°±åƒäººä½“å…ç–«ç³»ç»Ÿä¸€æ ·ï¼Œèƒ½è‡ªåŠ¨ä¿®å¤ä¸€äº›å°é—®é¢˜ã€‚

**ğŸ”§ è‡ªåŠ¨æ¢å¤æµç¨‹**
```
æ•…éšœæ£€æµ‹ â†’ é—®é¢˜è¯Šæ–­ â†’ è‡ªåŠ¨ä¿®å¤ â†’ ç»“æœéªŒè¯ â†’ äººå·¥å…œåº•
    â†“         â†“         â†“         â†“         â†“
  ç›‘æ§å‘Šè­¦   è§„åˆ™åŒ¹é…   æ‰§è¡ŒåŠ¨ä½œ   æ£€æŸ¥æ•ˆæœ   é€šçŸ¥äººå·¥
```

### 7.2 å¸¸è§æ•…éšœè‡ªåŠ¨æ¢å¤


**ğŸ”„ åˆ†ç‰‡é‡åˆ†é…æ¢å¤**
```json
PUT _watcher/watch/shard_allocation_recovery
{
  "trigger": {
    "schedule": {
      "interval": "2m"
    }
  },
  "input": {
    "http": {
      "request": {
        "scheme": "http",
        "host": "localhost",
        "port": 9200,
        "method": "get",
        "path": "/_cluster/health"
      }
    }
  },
  "condition": {
    "compare": {
      "ctx.payload.unassigned_shards": {
        "gt": 0
      }
    }
  },
  "actions": {
    "attempt_reroute": {
      "webhook": {
        "scheme": "http",
        "host": "localhost",
        "port": 9200,
        "method": "post",
        "path": "/_cluster/reroute",
        "body": """
        {
          "commands": [
            {
              "allocate_empty_primary": {
                "index": "{{ctx.payload.unassigned_info.index}}",
                "shard": {{ctx.payload.unassigned_info.shard}},
                "node": "{{ctx.payload.available_node}}",
                "accept_data_loss": false
              }
            }
          ]
        }
        """
      }
    },
    "notify_recovery_attempt": {
      "email": {
        "to": ["ops@company.com"],
        "subject": "ğŸ”„ ELKé›†ç¾¤è‡ªåŠ¨æ¢å¤å°è¯•",
        "body": """
          æ£€æµ‹åˆ°æœªåˆ†é…åˆ†ç‰‡ï¼Œæ­£åœ¨å°è¯•è‡ªåŠ¨æ¢å¤ï¼š
          
          æœªåˆ†é…åˆ†ç‰‡æ•°ï¼š{{ctx.payload.unassigned_shards}}
          é›†ç¾¤çŠ¶æ€ï¼š{{ctx.payload.status}}
          
          å·²æ‰§è¡Œè‡ªåŠ¨é‡åˆ†é…æ“ä½œã€‚
        """
      }
    }
  }
}
```

**ğŸ†˜ èŠ‚ç‚¹é‡å¯æ¢å¤**
```json
{
  "actions": {
    "restart_unhealthy_node": {
      "condition": {
        "script": {
          "source": """
            // åªæœ‰å½“èŠ‚ç‚¹è¿ç»­5åˆ†é’Ÿä¸å¥åº·æ‰é‡å¯
            return ctx.vars.node_unhealthy_duration > 300;
          """
        }
      },
      "webhook": {
        "scheme": "http",
        "host": "orchestrator.local",
        "port": 8080,
        "method": "post",
        "path": "/api/restart-node",
        "body": """
        {
          "action": "restart",
          "node_id": "{{ctx.vars.unhealthy_node}}",
          "reason": "health_check_failed",
          "automatic": true
        }
        """
      }
    },
    "escalate_to_human": {
      "condition": {
        "script": {
          "source": """
            // å¦‚æœè‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œå‡çº§ç»™äººå·¥å¤„ç†
            return ctx.vars.auto_recovery_failed;
          """
        }
      },
      "email": {
        "to": ["emergency@company.com"],
        "priority": "high",
        "subject": "ğŸš¨ ELKè‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥",
        "body": """
          è‡ªåŠ¨æ¢å¤å°è¯•å¤±è´¥ï¼Œéœ€è¦äººå·¥å¤„ç†ï¼š
          
          å¤±è´¥çš„èŠ‚ç‚¹ï¼š{{ctx.vars.unhealthy_node}}
          å°è¯•çš„æ¢å¤åŠ¨ä½œï¼š{{ctx.vars.recovery_actions}}
          å¤±è´¥åŸå› ï¼š{{ctx.vars.failure_reason}}
          
          è¯·ç«‹å³æ£€æŸ¥å¹¶æ‰‹åŠ¨å¤„ç†ï¼
        """
      }
    }
  }
}
```

### 7.3 æ¢å¤ç­–ç•¥é…ç½®


**ğŸ“‹ æ¢å¤ä¼˜å…ˆçº§ç­–ç•¥**
```yaml
# è‡ªåŠ¨æ¢å¤ç­–ç•¥é…ç½®
recovery_strategies:
  # çº§åˆ«1ï¼šè½»å¾®é—®é¢˜ï¼Œè‡ªåŠ¨ä¿®å¤
  level_1:
    conditions:
      - unassigned_shards < 5
      - cluster_status == "yellow"
    actions:
      - reroute_shards
      - wait_for_recovery: 5m
      
  # çº§åˆ«2ï¼šä¸­ç­‰é—®é¢˜ï¼Œè‡ªåŠ¨ä¿®å¤+é€šçŸ¥
  level_2:
    conditions:
      - unassigned_shards >= 5
      - cluster_status == "red"
      - node_count >= min_nodes
    actions:
      - force_allocate_primary
      - restart_failed_nodes
      - notify_ops_team
      - wait_for_recovery: 10m
      
  # çº§åˆ«3ï¼šä¸¥é‡é—®é¢˜ï¼Œäººå·¥ä»‹å…¥
  level_3:
    conditions:
      - node_count < min_nodes
      - data_loss_detected
    actions:
      - immediate_alert
      - disable_auto_actions
      - escalate_to_emergency
```

---

## 8. ğŸ“Š ç›‘æ§æ•°æ®å¯è§†åŒ–å±•ç¤º


### 8.1 Kibanaä»ªè¡¨æ¿è®¾è®¡


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> ç›‘æ§ä»ªè¡¨æ¿å°±åƒæ±½è½¦çš„"ä»ªè¡¨ç›˜"ï¼Œè®©ä½ ä¸€çœ¼å°±èƒ½çœ‹å‡ºè½¦å­ï¼ˆé›†ç¾¤ï¼‰çš„å„ç§çŠ¶æ€ï¼šé€Ÿåº¦ã€æ²¹é‡ã€æ¸©åº¦ç­‰ã€‚å¥½çš„ä»ªè¡¨æ¿åº”è¯¥è®©äºº3ç§’å†…å°±èƒ½åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦æ­£å¸¸ã€‚

**ğŸ¨ ä»ªè¡¨æ¿è®¾è®¡åŸåˆ™**
```
ä»ªè¡¨æ¿è®¾è®¡ä¸‰åŸåˆ™ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä¸€ç›®äº†ç„¶                    â”‚
â”‚    â”œâ”€ ç”¨é¢œè‰²è¡¨ç¤ºçŠ¶æ€           â”‚
â”‚    â”œâ”€ é‡è¦æŒ‡æ ‡æ”¾åœ¨æ˜¾çœ¼ä½ç½®     â”‚
â”‚    â””â”€ é¿å…ä¿¡æ¯è¿‡è½½             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. åˆ†å±‚å±•ç¤º                    â”‚
â”‚    â”œâ”€ æ€»è§ˆ â†’ è¯¦ç»† â†’ è°ƒè¯•       â”‚
â”‚    â”œâ”€ ä»å®è§‚åˆ°å¾®è§‚             â”‚
â”‚    â””â”€ æ”¯æŒä¸‹é’»åˆ†æ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. å®æ—¶æ›´æ–°                    â”‚
â”‚    â”œâ”€ å…³é”®æŒ‡æ ‡å®æ—¶åˆ·æ–°         â”‚
â”‚    â”œâ”€ å†å²è¶‹åŠ¿å¯¹æ¯”             â”‚
â”‚    â””â”€ å‘Šè­¦çŠ¶æ€åŒæ­¥æ˜¾ç¤º         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 æ ¸å¿ƒç›‘æ§é¢æ¿


**ğŸš¦ é›†ç¾¤å¥åº·æ€»è§ˆé¢æ¿**
```json
{
  "dashboard": {
    "title": "ELKé›†ç¾¤å¥åº·æ€»è§ˆ",
    "panels": [
      {
        "title": "é›†ç¾¤çŠ¶æ€",
        "type": "metric",
        "visualization": {
          "color_scheme": "traffic_light",
          "metric": "cluster.health.status",
          "display": {
            "green": "âœ… å¥åº·",
            "yellow": "âš ï¸ è­¦å‘Š", 
            "red": "ğŸš¨ æ•…éšœ"
          }
        }
      },
      {
        "title": "èŠ‚ç‚¹åœ¨çº¿çŠ¶æ€",
        "type": "gauge",
        "visualization": {
          "min": 0,
          "max": "total_nodes",
          "current": "active_nodes",
          "thresholds": [
            {"value": 80, "color": "red"},
            {"value": 90, "color": "yellow"},
            {"value": 100, "color": "green"}
          ]
        }
      },
      {
        "title": "åˆ†ç‰‡åˆ†å¸ƒ",
        "type": "donut",
        "visualization": {
          "fields": [
            "primary_shards",
            "replica_shards", 
            "unassigned_shards"
          ],
          "colors": ["#00C853", "#2196F3", "#F44336"]
        }
      }
    ]
  }
}
```

**ğŸ“ˆ æ€§èƒ½ç›‘æ§é¢æ¿**
```json
{
  "performance_dashboard": {
    "title": "ELKæ€§èƒ½ç›‘æ§",
    "refresh_interval": "30s",
    "panels": [
      {
        "title": "CPUä½¿ç”¨ç‡è¶‹åŠ¿",
        "type": "line_chart",
        "time_range": "last_1h",
        "metrics": [
          {
            "field": "node_stats.process.cpu.percent",
            "aggregation": "avg",
            "group_by": "source_node.name"
          }
        ],
        "thresholds": [
          {"value": 80, "color": "yellow"},
          {"value": 90, "color": "red"}
        ]
      },
      {
        "title": "å†…å­˜ä½¿ç”¨æƒ…å†µ",
        "type": "area_chart",
        "metrics": [
          "jvm.mem.heap_used_percent",
          "os.mem.used_percent"
        ],
        "colors": ["#FF9800", "#9C27B0"]
      },
      {
        "title": "æŸ¥è¯¢æ€§èƒ½",
        "type": "table",
        "columns": [
          "index_name",
          "query_rate",
          "avg_query_time",
          "slow_queries_count"
        ],
        "sort": {"field": "avg_query_time", "order": "desc"}
      }
    ]
  }
}
```

### 8.3 å‘Šè­¦çŠ¶æ€å±•ç¤º


**ğŸ”” å®æ—¶å‘Šè­¦é¢æ¿**
```json
{
  "alerts_dashboard": {
    "title": "å®æ—¶å‘Šè­¦çŠ¶æ€",
    "auto_refresh": "10s",
    "panels": [
      {
        "title": "æ´»è·ƒå‘Šè­¦",
        "type": "alert_list",
        "query": {
          "bool": {
            "must": [
              {"term": {"status": "firing"}},
              {"range": {"timestamp": {"gte": "now-24h"}}}
            ]
          }
        },
        "display": {
          "fields": [
            "alert_name",
            "severity", 
            "node_name",
            "triggered_at",
            "description"
          ],
          "color_coding": {
            "critical": "#F44336",
            "warning": "#FF9800",
            "info": "#2196F3"
          }
        }
      },
      {
        "title": "å‘Šè­¦è¶‹åŠ¿",
        "type": "timeline",
        "time_range": "last_7d",
        "aggregation": {
          "date_histogram": {
            "field": "timestamp",
            "interval": "1h"
          },
          "aggs": {
            "alert_count": {
              "terms": {
                "field": "severity"
              }
            }
          }
        }
      }
    ]
  }
}
```

**ğŸ“Š è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡**
```json
{
  "custom_metrics": {
    "title": "ä¸šåŠ¡ç›‘æ§æŒ‡æ ‡",
    "panels": [
      {
        "title": "æ—¥å¿—æ‘„å…¥é€Ÿç‡",
        "type": "metric",
        "query": {
          "aggs": {
            "ingest_rate": {
              "rate": {
                "field": "docs.count",
                "unit": "1s"
              }
            }
          }
        },
        "format": "logs/sec"
      },
      {
        "title": "ç´¢å¼•å¤§å°å¢é•¿",
        "type": "line_chart",
        "metrics": [
          "indices_stats.total.store.size_in_bytes"
        ],
        "group_by": "index_name",
        "time_range": "last_24h"
      },
      {
        "title": "çƒ­ç‚¹æŸ¥è¯¢Top10",
        "type": "data_table",
        "query": {
          "aggs": {
            "top_queries": {
              "terms": {
                "field": "query_hash",
                "size": 10,
                "order": {"query_count": "desc"}
              },
              "aggs": {
                "query_count": {"sum": {"field": "hit_count"}},
                "avg_response_time": {"avg": {"field": "response_time"}}
              }
            }
          }
        }
      }
    ]
  }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç›‘æ§æœ¬è´¨ï¼šåƒä½“æ£€ä¸€æ ·å®šæœŸæ£€æŸ¥ELKé›†ç¾¤å„é¡¹æŒ‡æ ‡
ğŸ”¸ å‘Šè­¦ä½œç”¨ï¼šåŠæ—¶å‘ç°é—®é¢˜ï¼Œé¿å…å°é—®é¢˜æ¼”å˜æˆå¤§æ•…éšœ  
ğŸ”¸ é˜ˆå€¼è®¾ç½®ï¼šåŸºäºå†å²æ•°æ®å’Œä¸šåŠ¡ç‰¹ç‚¹ï¼Œé¢„ç•™å®‰å…¨ä½™é‡
ğŸ”¸ è‡ªåŠ¨æ¢å¤ï¼šå¯¹è½»å¾®é—®é¢˜è‡ªåŠ¨ä¿®å¤ï¼Œä¸¥é‡é—®é¢˜äººå·¥ä»‹å…¥
ğŸ”¸ å¯è§†åŒ–å±•ç¤ºï¼šé€šè¿‡ä»ªè¡¨æ¿ç›´è§‚å±•ç¤ºé›†ç¾¤çŠ¶æ€å’Œè¶‹åŠ¿
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§æŒ‡æ ‡çš„ä¼˜å…ˆçº§**
```
ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ç›‘æ§ï¼‰ï¼š
â”œâ”€ é›†ç¾¤çŠ¶æ€ï¼ˆred/yellow/greenï¼‰
â”œâ”€ ç£ç›˜ä½¿ç”¨ç‡ï¼ˆå½±å“å†™å…¥ï¼‰  
â”œâ”€ å†…å­˜ä½¿ç”¨ç‡ï¼ˆå½±å“æ€§èƒ½ï¼‰
â””â”€ æœªåˆ†é…åˆ†ç‰‡æ•°ï¼ˆå½±å“å¯ç”¨æ€§ï¼‰

ç¬¬äºŒä¼˜å…ˆçº§ï¼ˆé‡è¦ç›‘æ§ï¼‰ï¼š
â”œâ”€ CPUä½¿ç”¨ç‡
â”œâ”€ æŸ¥è¯¢å“åº”æ—¶é—´
â”œâ”€ GCé¢‘ç‡
â””â”€ ç½‘ç»œIO

ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼ˆè¾…åŠ©ç›‘æ§ï¼‰ï¼š
â”œâ”€ ç´¢å¼•å¤§å°å¢é•¿é€Ÿåº¦
â”œâ”€ æ…¢æŸ¥è¯¢ç»Ÿè®¡  
â”œâ”€ ç¼“å­˜å‘½ä¸­ç‡
â””â”€ çº¿ç¨‹æ± çŠ¶æ€
```

**ğŸ”¹ å‘Šè­¦é€šçŸ¥çš„åˆ†çº§ç­–ç•¥**
```
å‘Šè­¦åˆ†çº§åŸåˆ™ï¼š
ğŸ”´ Criticalï¼šç«‹å³å¤„ç†ï¼Œé€šçŸ¥æ‰€æœ‰ç›¸å…³äººå‘˜
ğŸŸ¡ Warningï¼šå°½å¿«å¤„ç†ï¼Œé€šçŸ¥è¿ç»´å›¢é˜Ÿ
ğŸ”µ Infoï¼šå®šæœŸæ£€æŸ¥ï¼Œè®°å½•æ—¥å¿—å³å¯

é€šçŸ¥æ¸ é“é€‰æ‹©ï¼š
é‚®ä»¶ â†’ é€‚åˆè¯¦ç»†ä¿¡æ¯å’Œåç»­è·Ÿè¸ª
Slack â†’ é€‚åˆå›¢é˜Ÿåä½œå’Œå¿«é€Ÿå“åº”
çŸ­ä¿¡ â†’ é€‚åˆç´§æ€¥æƒ…å†µå’Œéå·¥ä½œæ—¶é—´
ç”µè¯ â†’ é€‚åˆä¸¥é‡æ•…éšœå’Œå…³é”®äººå‘˜
```

**ğŸ”¹ è‡ªåŠ¨æ¢å¤çš„è¾¹ç•Œ**
```
é€‚åˆè‡ªåŠ¨æ¢å¤çš„é—®é¢˜ï¼š
âœ… åˆ†ç‰‡é‡åˆ†é…
âœ… æœåŠ¡é‡å¯
âœ… ç´¢å¼•æ¸…ç†
âœ… é…ç½®è°ƒæ•´

éœ€è¦äººå·¥ä»‹å…¥çš„é—®é¢˜ï¼š
âŒ æ•°æ®ä¸¢å¤±
âŒ ç¡¬ä»¶æ•…éšœ  
âŒ ç½‘ç»œåˆ†åŒº
âŒ é…ç½®é”™è¯¯å¯¼è‡´çš„æ•…éšœ
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡ä»·å€¼ä½“ç°**
- **é¢„é˜²æ•…éšœ**ï¼šæå‰å‘ç°é—®é¢˜ï¼Œé¿å…ä¸šåŠ¡ä¸­æ–­
- **æå‡æ•ˆç‡**ï¼šè‡ªåŠ¨åŒ–å¤„ç†å¸¸è§é—®é¢˜ï¼Œå‡å°‘äººå·¥æŠ•å…¥
- **ä¼˜åŒ–æ€§èƒ½**ï¼šé€šè¿‡ç›‘æ§æ•°æ®æŒ‡å¯¼å®¹é‡è§„åˆ’å’Œä¼˜åŒ–
- **ä¿éšœSLA**ï¼šç¡®ä¿æœåŠ¡å¯ç”¨æ€§æ»¡è¶³ä¸šåŠ¡è¦æ±‚

**ğŸ› ï¸ è¿ç»´å®è·µå»ºè®®**
```
ç›‘æ§ç­–ç•¥å»ºè®®ï¼š
1. ä»ç®€å•å¼€å§‹ â†’ å…ˆç›‘æ§æœ€æ ¸å¿ƒçš„æŒ‡æ ‡
2. é€æ­¥å®Œå–„ â†’ æ ¹æ®å®é™…é—®é¢˜è¡¥å……ç›‘æ§é¡¹
3. å®šæœŸè¯„ä¼° â†’ è°ƒæ•´é˜ˆå€¼å’Œå‘Šè­¦è§„åˆ™  
4. æ–‡æ¡£è®°å½• â†’ è®°å½•æ•…éšœå¤„ç†ç»éªŒ

æœ€ä½³å®è·µï¼š
- å»ºç«‹ç›‘æ§æŒ‡æ ‡åŸºçº¿
- å®šæœŸæ¼”ç»ƒæ•…éšœæ¢å¤
- å»ºç«‹å‘Šè­¦å¤„ç†æµç¨‹
- æŒç»­ä¼˜åŒ–ç›‘æ§è§„åˆ™
```

> **ğŸ¯ æ ¸å¿ƒè®°å¿†**
> ELKç›‘æ§å¦‚åŒ»ç”Ÿä½“æ£€ï¼ŒæŒ‡æ ‡å¼‚å¸¸åŠæ—¶æŠ¥è­¦ã€‚
> ç£ç›˜ç©ºé—´æœ€å…³é”®ï¼Œè¶…é™å†™å…¥å°±åœæ­¢ã€‚  
> è‡ªåŠ¨æ¢å¤åˆ†è½»é‡ï¼Œä¸¥é‡æ•…éšœäººå·¥æ²»ã€‚
> å¯è§†åŒ–å±•ç¤ºè¦ç›´è§‚ï¼Œä¸€çœ¼çœ‹å‡ºç³»ç»ŸçŠ¶ã€‚

**å­¦ä¹ è¿›åº¦æ£€æŸ¥ï¼š**
- [ ] ç†è§£å„ç±»ç›‘æ§æŒ‡æ ‡çš„å«ä¹‰å’Œé‡è¦æ€§
- [ ] æŒæ¡Watcherå‘Šè­¦è§„åˆ™çš„é…ç½®æ–¹æ³•  
- [ ] å­¦ä¼šè®¾ç½®åˆç†çš„æ€§èƒ½é˜ˆå€¼
- [ ] äº†è§£è‡ªåŠ¨æ¢å¤æœºåˆ¶çš„åŸç†å’Œé™åˆ¶
- [ ] èƒ½å¤Ÿè®¾è®¡å®ç”¨çš„ç›‘æ§ä»ªè¡¨æ¿