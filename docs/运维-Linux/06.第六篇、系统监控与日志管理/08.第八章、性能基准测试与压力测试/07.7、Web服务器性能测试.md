---
title: 7ã€WebæœåŠ¡å™¨æ€§èƒ½æµ‹è¯•
---
## ğŸ“š ç›®å½•

1. [Webæ€§èƒ½æµ‹è¯•åŸºç¡€æ¦‚å¿µ](#1-Webæ€§èƒ½æµ‹è¯•åŸºç¡€æ¦‚å¿µ)
2. [Apache Bench (ab) åŸºç¡€æµ‹è¯•](#2-Apache-Bench-ab-åŸºç¡€æµ‹è¯•)
3. [wrkç°ä»£HTTPåŸºå‡†æµ‹è¯•å·¥å…·](#3-wrkç°ä»£HTTPåŸºå‡†æµ‹è¯•å·¥å…·)
4. [siegeç½‘ç«™å‹åŠ›æµ‹è¯•](#4-siegeç½‘ç«™å‹åŠ›æµ‹è¯•)
5. [é™æ€æ–‡ä»¶æœåŠ¡æ€§èƒ½æµ‹è¯•](#5-é™æ€æ–‡ä»¶æœåŠ¡æ€§èƒ½æµ‹è¯•)
6. [åŠ¨æ€å†…å®¹ç”Ÿæˆæ€§èƒ½æµ‹è¯•](#6-åŠ¨æ€å†…å®¹ç”Ÿæˆæ€§èƒ½æµ‹è¯•)
7. [å¹¶å‘ç”¨æˆ·æ•°å‹åŠ›æµ‹è¯•](#7-å¹¶å‘ç”¨æˆ·æ•°å‹åŠ›æµ‹è¯•)
8. [é•¿è¿æ¥æ€§èƒ½æµ‹è¯•](#8-é•¿è¿æ¥æ€§èƒ½æµ‹è¯•)
9. [HTTPSæ€§èƒ½å½±å“æµ‹è¯•](#9-HTTPSæ€§èƒ½å½±å“æµ‹è¯•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Webæ€§èƒ½æµ‹è¯•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Webæ€§èƒ½æµ‹è¯•


**åŸºæœ¬å®šä¹‰**ï¼š
Webæ€§èƒ½æµ‹è¯•å°±æ˜¯**æ£€éªŒç½‘ç«™åœ¨ä¸åŒè´Ÿè½½æƒ…å†µä¸‹çš„è¡¨ç°èƒ½åŠ›**ï¼Œå°±åƒç»™æ±½è½¦åšä½“æ£€ä¸€æ ·ï¼Œçœ‹çœ‹åœ¨ä¸åŒè·¯å†µä¸‹èƒ½è·‘å¤šå¿«ã€èƒ½æ‰¿å—å¤šå°‘é‡é‡ã€‚

**æ ¸å¿ƒç›®æ ‡**ï¼š
- **å“åº”é€Ÿåº¦**ï¼šç½‘é¡µæ‰“å¼€è¦å¤šé•¿æ—¶é—´
- **æ‰¿è½½èƒ½åŠ›**ï¼šåŒæ—¶èƒ½æœåŠ¡å¤šå°‘ç”¨æˆ·
- **ç¨³å®šæ€§**ï¼šé«˜è´Ÿè½½ä¸‹ä¼šä¸ä¼šå´©æºƒ
- **èµ„æºæ¶ˆè€—**ï¼šCPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ

### 1.2 æ€§èƒ½æµ‹è¯•çš„å…³é”®æŒ‡æ ‡


**âš¡ å“åº”æ—¶é—´æŒ‡æ ‡**
```
å“åº”æ—¶é—´ = ä»å‘é€è¯·æ±‚åˆ°æ”¶åˆ°å®Œæ•´å“åº”çš„æ—¶é—´

åˆ†ç±»ï¼š
â”œâ”€â”€ å¹³å‡å“åº”æ—¶é—´ï¼šæ‰€æœ‰è¯·æ±‚çš„å¹³å‡è€—æ—¶
â”œâ”€â”€ æœ€å°å“åº”æ—¶é—´ï¼šæœ€å¿«çš„é‚£æ¬¡è¯·æ±‚
â”œâ”€â”€ æœ€å¤§å“åº”æ—¶é—´ï¼šæœ€æ…¢çš„é‚£æ¬¡è¯·æ±‚
â””â”€â”€ 95%å“åº”æ—¶é—´ï¼š95%çš„è¯·æ±‚éƒ½åœ¨è¿™ä¸ªæ—¶é—´å†…å®Œæˆ
```

**ğŸ“Š ååé‡æŒ‡æ ‡**
```
ååé‡æŒ‡æ ‡ç³»ç»Ÿï¼š

QPS (Queries Per Second)ï¼šæ¯ç§’æŸ¥è¯¢æ•°
â”œâ”€â”€ å«ä¹‰ï¼šæœåŠ¡å™¨æ¯ç§’èƒ½å¤„ç†å¤šå°‘ä¸ªè¯·æ±‚
â”œâ”€â”€ è®¡ç®—ï¼šæ€»è¯·æ±‚æ•° Ã· æµ‹è¯•æ—¶é—´
â””â”€â”€ ç¤ºä¾‹ï¼š1000ä¸ªè¯·æ±‚è€—æ—¶10ç§’ = 100 QPS

TPS (Transactions Per Second)ï¼šæ¯ç§’äº‹åŠ¡æ•°
â”œâ”€â”€ å«ä¹‰ï¼šæ¯ç§’å®Œæˆçš„å®Œæ•´ä¸šåŠ¡æ“ä½œæ•°
â””â”€â”€ åŒºåˆ«ï¼šä¸€ä¸ªäº‹åŠ¡å¯èƒ½åŒ…å«å¤šä¸ªè¯·æ±‚

å¹¶å‘ç”¨æˆ·æ•°ï¼šåŒæ—¶è®¿é—®çš„ç”¨æˆ·æ•°é‡
â”œâ”€â”€ ç†è®ºå¹¶å‘ï¼šç³»ç»Ÿè®¾è®¡æ”¯æŒçš„æœ€å¤§ç”¨æˆ·æ•°
â””â”€â”€ å®é™…å¹¶å‘ï¼šå½“å‰æ—¶åˆ»çœŸæ­£åœ¨çº¿çš„ç”¨æˆ·æ•°
```

### 1.3 æµ‹è¯•ç±»å‹åˆ†ç±»


**ğŸ” æµ‹è¯•ç±»å‹å¯¹æ¯”**

| æµ‹è¯•ç±»å‹ | **ç›®çš„** | **è´Ÿè½½ç‰¹ç‚¹** | **å…³æ³¨æŒ‡æ ‡** |
|---------|----------|-------------|-------------|
| **åŸºå‡†æµ‹è¯•** | å»ºç«‹æ€§èƒ½åŸºçº¿ | æ­£å¸¸è´Ÿè½½ | å¹³å‡å“åº”æ—¶é—´ã€QPS |
| **è´Ÿè½½æµ‹è¯•** | éªŒè¯è®¾è®¡èƒ½åŠ› | é¢„æœŸæœ€å¤§è´Ÿè½½ | ç³»ç»Ÿç¨³å®šæ€§ã€èµ„æºä½¿ç”¨ç‡ |
| **å‹åŠ›æµ‹è¯•** | æ‰¾åˆ°æé™ | è¶…å‡ºæ­£å¸¸è´Ÿè½½ | å´©æºƒç‚¹ã€æ¢å¤èƒ½åŠ› |
| **å®¹é‡æµ‹è¯•** | ç¡®å®šæœ€å¤§å®¹é‡ | é€æ­¥å¢åŠ è´Ÿè½½ | æœ€å¤§å¹¶å‘æ•°ã€å³°å€¼QPS |

### 1.4 æµ‹è¯•ç¯å¢ƒæ¶æ„


**ğŸ—ï¸ å…¸å‹æµ‹è¯•æ¶æ„**
```
æµ‹è¯•å®¢æˆ·ç«¯                ç½‘ç»œ                ç›®æ ‡æœåŠ¡å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµ‹è¯•å·¥å…·    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ç½‘ç»œ  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  WebæœåŠ¡å™¨   â”‚
â”‚  - ab       â”‚         â”‚ å»¶è¿Ÿ  â”‚            â”‚  - Nginx    â”‚
â”‚  - wrk      â”‚         â”‚ å¸¦å®½  â”‚            â”‚  - Apache   â”‚
â”‚  - siege    â”‚         â”‚ ä¸¢åŒ…  â”‚            â”‚  - Tomcat   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â–²                                              â”‚
      â”‚                                              â–¼
   ç»“æœåˆ†æ                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚  åç«¯æœåŠ¡    â”‚
 â”‚  ç›‘æ§æ•°æ®    â”‚                              â”‚  - æ•°æ®åº“    â”‚
 â”‚  - CPUä½¿ç”¨ç‡ â”‚                              â”‚  - ç¼“å­˜      â”‚
 â”‚  - å†…å­˜ä½¿ç”¨é‡â”‚                              â”‚  - APIæœåŠ¡   â”‚
 â”‚  - ç½‘ç»œæµé‡  â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **é‡è¦æç¤º**ï¼šæµ‹è¯•ç¯å¢ƒè¦å°½é‡æ¥è¿‘ç”Ÿäº§ç¯å¢ƒï¼ŒåŒ…æ‹¬ç¡¬ä»¶é…ç½®ã€ç½‘ç»œç¯å¢ƒã€æ•°æ®é‡ç­‰ï¼Œè¿™æ ·æµ‹è¯•ç»“æœæ‰æœ‰å‚è€ƒä»·å€¼ã€‚

---

## 2. âš™ï¸ Apache Bench (ab) åŸºç¡€æµ‹è¯•


### 2.1 Apache Bench ç®€ä»‹


**ä»€ä¹ˆæ˜¯ab**ï¼š
Apache Benchæ˜¯ApacheæœåŠ¡å™¨è‡ªå¸¦çš„**HTTPæ€§èƒ½æµ‹è¯•å·¥å…·**ï¼Œå°±åƒä¸€ä¸ªä¸“é—¨æµ‹è¯•ç½‘ç«™é€Ÿåº¦çš„"è·‘åˆ†è½¯ä»¶"ï¼Œç®€å•æ˜“ç”¨ï¼Œæ˜¯æœ€ç»å…¸çš„Webæ€§èƒ½æµ‹è¯•å·¥å…·ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **ç®€å•ç›´æ¥**ï¼šä¸€æ¡å‘½ä»¤å°±èƒ½æµ‹è¯•
- **è½»é‡çº§**ï¼šä¸éœ€è¦å¤æ‚é…ç½®
- **æ ‡å‡†åŒ–**ï¼šä¸šç•Œå¹¿æ³›ä½¿ç”¨çš„åŸºå‡†å·¥å…·
- **è·¨å¹³å°**ï¼šLinuxã€Windowsã€Macéƒ½æ”¯æŒ

### 2.2 åŸºæœ¬ä½¿ç”¨æ–¹æ³•


**ğŸ“¦ å®‰è£…abå·¥å…·**
```bash
# Ubuntu/Debianç³»ç»Ÿ
sudo apt install apache2-utils

# CentOS/RHELç³»ç»Ÿ  
sudo yum install httpd-tools

# éªŒè¯å®‰è£…
ab -V
```

**ğŸ”§ åŸºæœ¬å‘½ä»¤æ ¼å¼**
```bash
ab [é€‰é¡¹] [ç›®æ ‡URL]

å¸¸ç”¨é€‰é¡¹è¯´æ˜ï¼š
-nï¼šæ€»è¯·æ±‚æ•°é‡
-cï¼šå¹¶å‘è¿æ¥æ•°  
-tï¼šæµ‹è¯•æŒç»­æ—¶é—´(ç§’)
-kï¼šå¯ç”¨HTTP KeepAlive
-Hï¼šæ·»åŠ HTTPå¤´éƒ¨
-pï¼šPOSTæ•°æ®æ–‡ä»¶
-Tï¼šContent-Typeç±»å‹
```

### 2.3 å®é™…æµ‹è¯•ç¤ºä¾‹


**ğŸ¯ åŸºç¡€æ€§èƒ½æµ‹è¯•**
```bash
# å‘é€1000ä¸ªè¯·æ±‚ï¼Œ10ä¸ªå¹¶å‘è¿æ¥
ab -n 1000 -c 10 http://www.example.com/

# æµ‹è¯•ç»“æœè§£è¯»ï¼š
Server Software:        nginx/1.18.0    # æœåŠ¡å™¨è½¯ä»¶
Server Hostname:        www.example.com  # æœåŠ¡å™¨ä¸»æœºå
Server Port:            80               # ç«¯å£å·

Document Path:          /                # æµ‹è¯•è·¯å¾„
Document Length:        1024 bytes       # æ–‡æ¡£å¤§å°

Concurrency Level:      10               # å¹¶å‘çº§åˆ«
Time taken for tests:   5.234 seconds    # æ€»æµ‹è¯•æ—¶é—´
Complete requests:      1000             # å®Œæˆçš„è¯·æ±‚æ•°
Failed requests:        0                # å¤±è´¥çš„è¯·æ±‚æ•°
Total transferred:      1245000 bytes    # æ€»ä¼ è¾“å­—èŠ‚æ•°
HTML transferred:       1024000 bytes    # HTMLä¼ è¾“å­—èŠ‚æ•°
Requests per second:    191.05 [#/sec]   # æ¯ç§’è¯·æ±‚æ•°(QPS)
Time per request:       52.342 [ms]      # æ¯ä¸ªè¯·æ±‚å¹³å‡æ—¶é—´
Transfer rate:          232.15 [Kbytes/sec] # ä¼ è¾“é€Ÿç‡
```

**â±ï¸ æŒç»­æ—¶é—´æµ‹è¯•**
```bash
# æŒç»­æµ‹è¯•30ç§’ï¼Œ20ä¸ªå¹¶å‘
ab -t 30 -c 20 -k http://localhost/index.html

# -kå‚æ•°çš„ä½œç”¨ï¼š
å¯ç”¨HTTP Keep-Aliveï¼šå¤ç”¨TCPè¿æ¥ï¼Œå‡å°‘å»ºè¿å¼€é”€
é€‚ç”¨åœºæ™¯ï¼šæ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è¡Œä¸º
æ€§èƒ½å½±å“ï¼šé€šå¸¸èƒ½æå‡20-30%çš„QPS
```

### 2.4 é«˜çº§æµ‹è¯•é…ç½®


**ğŸ“ POSTè¯·æ±‚æµ‹è¯•**
```bash
# åˆ›å»ºPOSTæ•°æ®æ–‡ä»¶
echo '{"username":"test","password":"123456"}' > post_data.json

# æ‰§è¡ŒPOSTæµ‹è¯•
ab -n 100 -c 5 -p post_data.json -T 'application/json' \
   http://api.example.com/login

# å‚æ•°è¯´æ˜ï¼š
-p post_data.jsonï¼šæŒ‡å®šPOSTæ•°æ®æ–‡ä»¶
-T 'application/json'ï¼šè®¾ç½®Content-Type
```

**ğŸ”’ è‡ªå®šä¹‰HTTPå¤´éƒ¨**
```bash
# æ·»åŠ è®¤è¯å¤´éƒ¨æµ‹è¯•
ab -n 500 -c 10 \
   -H "Authorization: Bearer your-token-here" \
   -H "User-Agent: TestClient/1.0" \
   http://api.example.com/protected

# å¤šä¸ª-Hå‚æ•°å¯ä»¥æ·»åŠ å¤šä¸ªå¤´éƒ¨
```

### 2.5 ç»“æœåˆ†ææŠ€å·§


**ğŸ“Š å…³é”®æŒ‡æ ‡è§£è¯»**
```
æ€§èƒ½åˆ†æè¦ç‚¹ï¼š

QPS (Requests per second)ï¼š
â”œâ”€â”€ ä¼˜ç§€ï¼š> 1000 QPS
â”œâ”€â”€ è‰¯å¥½ï¼š500-1000 QPS  
â”œâ”€â”€ ä¸€èˆ¬ï¼š100-500 QPS
â””â”€â”€ è¾ƒå·®ï¼š< 100 QPS

å“åº”æ—¶é—´ï¼š
â”œâ”€â”€ æå¿«ï¼š< 50ms
â”œâ”€â”€ å¿«é€Ÿï¼š50-200ms
â”œâ”€â”€ å¯æ¥å—ï¼š200-1000ms
â””â”€â”€ æ…¢ï¼š> 1000ms

å¤±è´¥ç‡ï¼š
â”œâ”€â”€ ç†æƒ³ï¼š0%
â”œâ”€â”€ å¯æ¥å—ï¼š< 1%
â”œâ”€â”€ éœ€è¦ä¼˜åŒ–ï¼š1-5%
â””â”€â”€ æœ‰é—®é¢˜ï¼š> 5%
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šabå·¥å…·æ˜¯å•çº¿ç¨‹çš„ï¼Œå¯¹äºé«˜æ€§èƒ½æœåŠ¡å™¨å¯èƒ½æ— æ³•å‹æ»¡å…¶çœŸå®èƒ½åŠ›ï¼Œéœ€è¦å¤šå®ä¾‹å¹¶å‘æµ‹è¯•ã€‚

---

## 3. ğŸš€ wrkç°ä»£HTTPåŸºå‡†æµ‹è¯•å·¥å…·


### 3.1 wrkå·¥å…·ä»‹ç»


**ä»€ä¹ˆæ˜¯wrk**ï¼š
wrkæ˜¯ä¸€ä¸ª**ç°ä»£åŒ–çš„HTTPåŸºå‡†æµ‹è¯•å·¥å…·**ï¼Œç›¸æ¯”abå·¥å…·ï¼Œå®ƒå°±åƒä»è‡ªè¡Œè½¦å‡çº§åˆ°äº†è·‘è½¦ï¼Œèƒ½å¤Ÿäº§ç”Ÿæ›´é«˜çš„è´Ÿè½½ï¼Œæ”¯æŒæ›´å¤æ‚çš„æµ‹è¯•åœºæ™¯ã€‚

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **é«˜æ€§èƒ½**ï¼šå¤šçº¿ç¨‹è®¾è®¡ï¼Œèƒ½äº§ç”Ÿæ›´é«˜è´Ÿè½½
- **å¯ç¼–ç¨‹**ï¼šæ”¯æŒLuaè„šæœ¬ï¼Œå¯ä»¥è‡ªå®šä¹‰æµ‹è¯•é€»è¾‘
- **ç°ä»£åŒ–**ï¼šæ”¯æŒHTTP/1.1çš„æ‰€æœ‰ç‰¹æ€§
- **å‡†ç¡®æ€§**ï¼šæ›´ç²¾ç¡®çš„å»¶è¿Ÿç»Ÿè®¡

### 3.2 å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨


**ğŸ“¦ å®‰è£…wrk**
```bash
# Ubuntu/Debianç³»ç»Ÿ
sudo apt install wrk

# æˆ–è€…ä»æºç ç¼–è¯‘
git clone https://github.com/wg/wrk.git
cd wrk
make
sudo cp wrk /usr/local/bin/
```

**ğŸ”§ åŸºæœ¬å‘½ä»¤æ ¼å¼**
```bash
wrk [é€‰é¡¹] <URL>

æ ¸å¿ƒå‚æ•°ï¼š
-cï¼šå¹¶å‘è¿æ¥æ•°
-dï¼šæµ‹è¯•æŒç»­æ—¶é—´
-tï¼šä½¿ç”¨çš„çº¿ç¨‹æ•°
-sï¼šLuaè„šæœ¬æ–‡ä»¶
-Hï¼šæ·»åŠ HTTPå¤´éƒ¨
--timeoutï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´
--latencyï¼šæ˜¾ç¤ºå»¶è¿Ÿç»Ÿè®¡
```

### 3.3 åŸºç¡€æµ‹è¯•ç¤ºä¾‹


**âš¡ ç®€å•æ€§èƒ½æµ‹è¯•**
```bash
# ä½¿ç”¨12ä¸ªçº¿ç¨‹ï¼Œ400ä¸ªè¿æ¥ï¼ŒæŒç»­30ç§’
wrk -t12 -c400 -d30s --latency http://www.example.com/

# æµ‹è¯•ç»“æœç¤ºä¾‹ï¼š
Running 30s test @ http://www.example.com/
  12 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   635.91us    0.89ms  12.92ms   93.69%
    Req/Sec    56.20k     8.07k   62.00k    86.54%
  Latency Distribution
     50%  532.00us
     75%  853.00us  
     90%    1.22ms
     99%    2.78ms
  20177745 requests in 30.00s, 2.56GB read
Requests/sec: 672577.64
Transfer/sec:     87.37MB/sec
```

**ğŸ“ˆ è´Ÿè½½å¯¹æ¯”æµ‹è¯•**
```bash
# ä¸åŒå¹¶å‘çº§åˆ«çš„å¯¹æ¯”æµ‹è¯•
echo "æµ‹è¯•å¹¶å‘50ï¼š"
wrk -t4 -c50 -d10s http://localhost/

echo "æµ‹è¯•å¹¶å‘200ï¼š"  
wrk -t8 -c200 -d10s http://localhost/

echo "æµ‹è¯•å¹¶å‘500ï¼š"
wrk -t12 -c500 -d10s http://localhost/
```

### 3.4 Luaè„šæœ¬é«˜çº§åŠŸèƒ½


**ğŸ“ è‡ªå®šä¹‰è¯·æ±‚è„šæœ¬**
```lua
-- åˆ›å»ºæ–‡ä»¶ï¼špost_test.lua
wrk.method = "POST"
wrk.body   = '{"action":"test","data":"benchmark"}'
wrk.headers["Content-Type"] = "application/json"

-- æ¯ä¸ªè¯·æ±‚å‰çš„è®¾ç½®
function request()
    -- å¯ä»¥åœ¨è¿™é‡ŒåŠ¨æ€ä¿®æ”¹è¯·æ±‚
    return wrk.format(wrk.method, wrk.path, wrk.headers, wrk.body)
end

-- å“åº”å¤„ç†å‡½æ•°
function response(status, headers, body)
    if status ~= 200 then
        print("Error: " .. status)
    end
end
```

```bash
# ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬æµ‹è¯•
wrk -t8 -c100 -d30s -s post_test.lua http://api.example.com/endpoint
```

**ğŸ”„ åŠ¨æ€æ•°æ®æµ‹è¯•**
```lua
-- åˆ›å»ºæ–‡ä»¶ï¼šdynamic_test.lua
local counter = 0
local thread_id = 1

function setup(thread)
    thread:set("id", thread_id)
    thread_id = thread_id + 1
end

function request()
    counter = counter + 1
    local path = "/api/user/" .. counter
    return wrk.format("GET", path)
end
```

### 3.5 ç»“æœåˆ†æ


**ğŸ“Š å»¶è¿Ÿåˆ†å¸ƒåˆ†æ**
```
å»¶è¿Ÿç»Ÿè®¡è§£è¯»ï¼š

Latency Distribution:
â”œâ”€â”€ 50%: 532.00us    â† ä¸€åŠè¯·æ±‚åœ¨532å¾®ç§’å†…å®Œæˆ
â”œâ”€â”€ 75%: 853.00us    â† 75%è¯·æ±‚åœ¨853å¾®ç§’å†…å®Œæˆ  
â”œâ”€â”€ 90%: 1.22ms      â† 90%è¯·æ±‚åœ¨1.22æ¯«ç§’å†…å®Œæˆ
â””â”€â”€ 99%: 2.78ms      â† 99%è¯·æ±‚åœ¨2.78æ¯«ç§’å†…å®Œæˆ

æ€§èƒ½è¯„ä¼°æ ‡å‡†ï¼š
â”œâ”€â”€ ä¼˜ç§€ï¼š99%å»¶è¿Ÿ < 10ms
â”œâ”€â”€ è‰¯å¥½ï¼š99%å»¶è¿Ÿ < 50ms
â”œâ”€â”€ å¯æ¥å—ï¼š99%å»¶è¿Ÿ < 200ms
â””â”€â”€ éœ€è¦ä¼˜åŒ–ï¼š99%å»¶è¿Ÿ > 200ms
```

> ğŸ’¡ **ä¸“ä¸šæç¤º**ï¼šwrkæ¯”abèƒ½äº§ç”Ÿæ›´é«˜çš„è´Ÿè½½ï¼Œæ›´é€‚åˆæµ‹è¯•é«˜æ€§èƒ½WebæœåŠ¡å™¨çš„çœŸå®èƒ½åŠ›ã€‚

---

## 4. ğŸ° siegeç½‘ç«™å‹åŠ›æµ‹è¯•


### 4.1 siegeå·¥å…·æ¦‚è¿°


**ä»€ä¹ˆæ˜¯siege**ï¼š
siegeæ˜¯ä¸€ä¸ª**å¤šçº¿ç¨‹HTTPè´Ÿè½½æµ‹è¯•å·¥å…·**ï¼Œåå­—æ¥æºäº"å›´æ”»"ï¼Œå°±åƒæ¨¡æ‹Ÿå¤§é‡ç”¨æˆ·åŒæ—¶"å›´æ”»"ä½ çš„ç½‘ç«™ï¼Œçœ‹çœ‹ç½‘ç«™èƒ½å¦é¡¶ä½å‹åŠ›ã€‚

**ç‹¬ç‰¹ç‰¹ç‚¹**ï¼š
- **çœŸå®ç”¨æˆ·æ¨¡æ‹Ÿ**ï¼šæ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„è®¿é—®è¡Œä¸º
- **å¤šURLæµ‹è¯•**ï¼šå¯ä»¥åŒæ—¶æµ‹è¯•å¤šä¸ªä¸åŒçš„URL
- **é…ç½®çµæ´»**ï¼šæ”¯æŒå¤æ‚çš„æµ‹è¯•åœºæ™¯é…ç½®
- **æŠ¥å‘Šè¯¦ç»†**ï¼šæä¾›ä¸°å¯Œçš„æµ‹è¯•æŠ¥å‘Š

### 4.2 å®‰è£…ä¸é…ç½®


**ğŸ“¦ å®‰è£…siege**
```bash
# Ubuntu/Debianç³»ç»Ÿ
sudo apt install siege

# CentOS/RHELç³»ç»Ÿ
sudo yum install siege

# éªŒè¯å®‰è£…
siege --version
```

**âš™ï¸ åŸºç¡€é…ç½®**
```bash
# ç”Ÿæˆé…ç½®æ–‡ä»¶
siege.config

# ä¸»è¦é…ç½®é¡¹è¯´æ˜
vim ~/.siege/siege.conf

# å…³é”®é…ç½®å‚æ•°ï¼š
verbose = true           # æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
csv = false             # æ˜¯å¦è¾“å‡ºCSVæ ¼å¼
delay = 1               # è¯·æ±‚é—´å»¶è¿Ÿ(ç§’)
timeout = 30            # è¶…æ—¶æ—¶é—´
failures = 1024         # å…è®¸çš„å¤±è´¥æ¬¡æ•°
```

### 4.3 åŸºæœ¬ä½¿ç”¨æ–¹æ³•


**ğŸ¯ å•URLå‹åŠ›æµ‹è¯•**
```bash
# åŸºæœ¬è¯­æ³•
siege [é€‰é¡¹] URL

# æ¨¡æ‹Ÿ50ä¸ªç”¨æˆ·æŒç»­è®¿é—®10åˆ†é’Ÿ
siege -c 50 -t 10m http://www.example.com/

# æ¨¡æ‹Ÿ100ä¸ªç”¨æˆ·è®¿é—®1000æ¬¡
siege -c 100 -r 10 http://www.example.com/

# å‚æ•°è¯´æ˜ï¼š
-cï¼šå¹¶å‘ç”¨æˆ·æ•°
-tï¼šæµ‹è¯•æŒç»­æ—¶é—´ (10s, 5m, 1h)
-rï¼šæ¯ä¸ªç”¨æˆ·é‡å¤æ¬¡æ•°
-dï¼šç”¨æˆ·é—´éšæœºå»¶è¿Ÿ
```

**ğŸ“‹ å¤šURLæµ‹è¯•æ–‡ä»¶**
```bash
# åˆ›å»ºURLåˆ—è¡¨æ–‡ä»¶
cat > urls.txt << EOF
http://www.example.com/
http://www.example.com/about
http://www.example.com/products
http://www.example.com/contact
GET http://api.example.com/users
POST http://api.example.com/login {"username":"test"}
EOF

# ä½¿ç”¨URLæ–‡ä»¶æµ‹è¯•
siege -c 25 -t 5m -f urls.txt
```

### 4.4 é«˜çº§æµ‹è¯•åœºæ™¯


**ğŸ”„ æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º**
```bash
# å¸¦éšæœºå»¶è¿Ÿçš„æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿç”¨æˆ·æ€è€ƒæ—¶é—´ï¼‰
siege -c 20 -t 30m -d 1 -f urls.txt

# å‚æ•°è¯´æ˜ï¼š
-d 1ï¼šç”¨æˆ·è¯·æ±‚é—´éšæœºå»¶è¿Ÿ0-1ç§’
è¿™æ ·æ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„é˜…è¯»å’Œæ€è€ƒæ—¶é—´
```

**ğŸ“Š åŸºå‡†æµ‹è¯•æ¨¡å¼**
```bash
# æ— å»¶è¿Ÿçš„åŸºå‡†æµ‹è¯•
siege -c 50 -r 100 -b http://www.example.com/

# -bå‚æ•°ï¼šbenchmarkæ¨¡å¼ï¼Œæ— å»¶è¿Ÿï¼Œæµ‹è¯•æœ€å¤§æ€§èƒ½
```

**ğŸ”’ è®¤è¯æµ‹è¯•**
```bash
# HTTPåŸºæœ¬è®¤è¯
siege -c 10 -t 1m -A "username:password" http://protected.example.com/

# è‡ªå®šä¹‰HTTPå¤´éƒ¨
siege -c 20 -t 2m -H "Authorization: Bearer token123" http://api.example.com/
```

### 4.5 æµ‹è¯•ç»“æœåˆ†æ


**ğŸ“ˆ è¾“å‡ºæŠ¥å‘Šè§£è¯»**
```
å…¸å‹siegeæŠ¥å‘Šï¼š

Transactions:               3024 hits      # æˆåŠŸçš„äº‹åŠ¡æ•°
Availability:              99.67 %         # å¯ç”¨æ€§ç™¾åˆ†æ¯”
Elapsed time:              59.78 secs      # æ€»æµ‹è¯•æ—¶é—´
Data transferred:           0.84 MB        # ä¼ è¾“çš„æ•°æ®é‡
Response time:              0.25 secs      # å¹³å‡å“åº”æ—¶é—´
Transaction rate:          50.58 trans/sec # äº‹åŠ¡ç‡(TPS)
Throughput:                 0.01 MB/sec    # ååé‡
Concurrency:               12.53           # å®é™…å¹¶å‘æ•°
Successful transactions:    3024           # æˆåŠŸäº‹åŠ¡æ•°
Failed transactions:        10             # å¤±è´¥äº‹åŠ¡æ•°
Longest transaction:        1.17 secs      # æœ€é•¿äº‹åŠ¡æ—¶é—´
Shortest transaction:       0.00 secs      # æœ€çŸ­äº‹åŠ¡æ—¶é—´
```

**ğŸ¯ å…³é”®æŒ‡æ ‡è¯´æ˜**

| æŒ‡æ ‡ | **å«ä¹‰** | **ä¼˜ç§€æ ‡å‡†** | **è¯´æ˜** |
|------|----------|-------------|----------|
| **Availability** | å¯ç”¨æ€§ | > 99.5% | ç³»ç»Ÿæ­£å¸¸å“åº”çš„æ¯”ä¾‹ |
| **Response time** | å“åº”æ—¶é—´ | < 1ç§’ | ç”¨æˆ·æ„Ÿå—çš„é¡µé¢åŠ è½½æ—¶é—´ |
| **Transaction rate** | äº‹åŠ¡ç‡ | è§†ä¸šåŠ¡è€Œå®š | ç³»ç»Ÿå¤„ç†èƒ½åŠ›æŒ‡æ ‡ |
| **Concurrency** | å¹¶å‘æ•° | æ¥è¿‘è®¾ç½®å€¼ | å®é™…åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•° |

> ğŸ” **åˆ†ææŠ€å·§**ï¼šå…³æ³¨Availabilityå’ŒResponse timeä¸¤ä¸ªæŒ‡æ ‡ï¼Œå®ƒä»¬ç›´æ¥åæ˜ ç”¨æˆ·ä½“éªŒè´¨é‡ã€‚

---

## 5. ğŸ“ é™æ€æ–‡ä»¶æœåŠ¡æ€§èƒ½æµ‹è¯•


### 5.1 é™æ€æ–‡ä»¶æœåŠ¡ç‰¹ç‚¹


**ä»€ä¹ˆæ˜¯é™æ€æ–‡ä»¶æœåŠ¡**ï¼š
é™æ€æ–‡ä»¶æœåŠ¡å°±æ˜¯ç›´æ¥ä¼ è¾“**ä¸éœ€è¦åŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶**ï¼Œæ¯”å¦‚å›¾ç‰‡ã€CSSã€JavaScriptã€HTMLæ–‡ä»¶ç­‰ï¼Œå°±åƒå›¾ä¹¦é¦†å€Ÿä¹¦ä¸€æ ·ï¼Œä¹¦æ˜¯ç°æˆçš„ï¼Œç›´æ¥æ‹¿ç»™ä½ å°±è¡Œã€‚

**æ€§èƒ½ç‰¹å¾**ï¼š
- **é«˜å¹¶å‘èƒ½åŠ›**ï¼šæ— éœ€è®¡ç®—å¤„ç†ï¼Œä¸»è¦å—ç½‘ç»œå’Œç£ç›˜IOé™åˆ¶
- **ç¼“å­˜å‹å¥½**ï¼šå®¹æ˜“è¢«æµè§ˆå™¨å’ŒCDNç¼“å­˜
- **èµ„æºæ¶ˆè€—ä½**ï¼šä¸»è¦æ¶ˆè€—å¸¦å®½å’Œå°‘é‡CPU
- **å¯é¢„æµ‹æ€§å¼º**ï¼šæ€§èƒ½è¡¨ç°ç›¸å¯¹ç¨³å®š

### 5.2 æµ‹è¯•ç¯å¢ƒå‡†å¤‡


**ğŸ”§ å‡†å¤‡æµ‹è¯•æ–‡ä»¶**
```bash
# åˆ›å»ºä¸åŒå¤§å°çš„æµ‹è¯•æ–‡ä»¶
mkdir /var/www/static-test
cd /var/www/static-test

# å°æ–‡ä»¶æµ‹è¯• (1KB)
dd if=/dev/zero of=small.txt bs=1024 count=1

# ä¸­ç­‰æ–‡ä»¶æµ‹è¯• (100KB)  
dd if=/dev/zero of=medium.txt bs=1024 count=100

# å¤§æ–‡ä»¶æµ‹è¯• (1MB)
dd if=/dev/zero of=large.txt bs=1024 count=1024

# å›¾ç‰‡æ–‡ä»¶æµ‹è¯•
cp /path/to/test.jpg ./test.jpg
cp /path/to/test.png ./test.png
```

**ğŸŒ Nginxé™æ€æ–‡ä»¶é…ç½®**
```nginx
# /etc/nginx/sites-available/static-test
server {
    listen 80;
    server_name static-test.local;
    root /var/www/static-test;
    
    # é™æ€æ–‡ä»¶ä¼˜åŒ–é…ç½®
    location ~* \.(txt|jpg|png|css|js)$ {
        expires 1d;                    # è®¾ç½®ç¼“å­˜æ—¶é—´
        add_header Cache-Control "public, immutable";
        gzip on;                       # å¯ç”¨å‹ç¼©
        gzip_types text/plain image/jpeg image/png;
    }
    
    # ç¦ç”¨è®¿é—®æ—¥å¿—ï¼ˆå‡å°‘IOå¼€é”€ï¼‰
    access_log off;
}
```

### 5.3 åŸºç¡€æ€§èƒ½æµ‹è¯•


**âš¡ å°æ–‡ä»¶é«˜å¹¶å‘æµ‹è¯•**
```bash
# æµ‹è¯•å°æ–‡ä»¶çš„å¹¶å‘å¤„ç†èƒ½åŠ›
wrk -t8 -c200 -d30s http://static-test.local/small.txt

# é¢„æœŸç»“æœåˆ†æï¼š
# ä¼˜ç§€çš„é™æ€æ–‡ä»¶æœåŠ¡å™¨åº”è¯¥èƒ½è¾¾åˆ°ï¼š
# - QPS: 10,000-50,000+
# - å»¶è¿Ÿ: < 10ms
# - CPUä½¿ç”¨ç‡: < 30%
```

**ğŸ“Š ä¸åŒæ–‡ä»¶å¤§å°å¯¹æ¯”**
```bash
#!/bin/bash
# åˆ›å»ºè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
echo "=== é™æ€æ–‡ä»¶æ€§èƒ½å¯¹æ¯”æµ‹è¯• ==="

echo "æµ‹è¯•å°æ–‡ä»¶ (1KB):"
wrk -t4 -c100 -d10s http://static-test.local/small.txt | grep "Requests/sec"

echo "æµ‹è¯•ä¸­ç­‰æ–‡ä»¶ (100KB):"
wrk -t4 -c100 -d10s http://static-test.local/medium.txt | grep "Requests/sec"

echo "æµ‹è¯•å¤§æ–‡ä»¶ (1MB):"
wrk -t4 -c100 -d10s http://static-test.local/large.txt | grep "Requests/sec"
```

### 5.4 å‹ç¼©æ•ˆæœæµ‹è¯•


**ğŸ—œï¸ Gzipå‹ç¼©æ€§èƒ½å¯¹æ¯”**
```bash
# ç¦ç”¨å‹ç¼©çš„æµ‹è¯•
curl -H "Accept-Encoding: identity" -w "@curl-format.txt" \
     http://static-test.local/medium.txt

# å¯ç”¨å‹ç¼©çš„æµ‹è¯•  
curl -H "Accept-Encoding: gzip" -w "@curl-format.txt" \
     http://static-test.local/medium.txt

# curlæ ¼å¼æ–‡ä»¶å†…å®¹ (curl-format.txt):
     time_namelookup:  %{time_namelookup}\n
      time_connect:  %{time_connect}\n
   time_appconnect:  %{time_appconnect}\n
  time_pretransfer:  %{time_pretransfer}\n
     time_redirect:  %{time_redirect}\n
time_starttransfer:  %{time_starttransfer}\n
                   ----------\n
        time_total:  %{time_total}\n
        size_download:  %{size_download}\n
```

### 5.5 ç¼“å­˜æ•ˆæœæµ‹è¯•


**ğŸ’¾ æµè§ˆå™¨ç¼“å­˜æµ‹è¯•**
```bash
# é¦–æ¬¡è®¿é—®ï¼ˆæ— ç¼“å­˜ï¼‰
curl -w "@curl-format.txt" -o /dev/null -s http://static-test.local/test.jpg

# å¸¦ç¼“å­˜å¤´çš„è®¿é—®
curl -H "If-Modified-Since: $(date -R)" \
     -w "HTTPçŠ¶æ€ç : %{http_code}\n" \
     http://static-test.local/test.jpg

# 304çŠ¶æ€ç è¡¨ç¤ºèµ„æºæœªä¿®æ”¹ï¼Œä½¿ç”¨ç¼“å­˜
```

### 5.6 æ€§èƒ½åŸºå‡†å»ºç«‹


**ğŸ“‹ é™æ€æ–‡ä»¶æœåŠ¡æ€§èƒ½æ ‡å‡†**

| æ–‡ä»¶å¤§å° | **æœŸæœ›QPS** | **æœŸæœ›å»¶è¿Ÿ** | **CPUä½¿ç”¨ç‡** |
|---------|------------|-------------|-------------|
| **< 10KB** | > 20,000 | < 5ms | < 20% |
| **10-100KB** | > 5,000 | < 20ms | < 40% |
| **100KB-1MB** | > 1,000 | < 100ms | < 60% |
| **> 1MB** | > 100 | < 500ms | < 80% |

> âš¡ **ä¼˜åŒ–æç¤º**ï¼šé™æ€æ–‡ä»¶æœåŠ¡çš„æ€§èƒ½ç“¶é¢ˆé€šå¸¸åœ¨ç½‘ç»œå¸¦å®½è€Œä¸æ˜¯æœåŠ¡å™¨å¤„ç†èƒ½åŠ›ï¼Œåˆç†ä½¿ç”¨CDNå’Œç¼“å­˜æ˜¯å…³é”®ã€‚

---

## 6. ğŸ”„ åŠ¨æ€å†…å®¹ç”Ÿæˆæ€§èƒ½æµ‹è¯•


### 6.1 åŠ¨æ€å†…å®¹æœåŠ¡ç‰¹ç‚¹


**ä»€ä¹ˆæ˜¯åŠ¨æ€å†…å®¹ç”Ÿæˆ**ï¼š
åŠ¨æ€å†…å®¹æ˜¯**éœ€è¦æœåŠ¡å™¨å®æ—¶è®¡ç®—å’Œç”Ÿæˆçš„å†…å®¹**ï¼Œå°±åƒé¤å…çš„ç°åšèœå“ï¼Œæ¯æ¬¡éƒ½è¦æ ¹æ®è®¢å•é‡æ–°åˆ¶ä½œï¼Œæ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢ç»“æœã€ç”¨æˆ·ä¸ªæ€§åŒ–é¡µé¢ã€APIæ¥å£å“åº”ç­‰ã€‚

**æ€§èƒ½æŒ‘æˆ˜**ï¼š
- **CPUå¯†é›†**ï¼šéœ€è¦æ‰§è¡Œä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å¤„ç†
- **å†…å­˜æ¶ˆè€—**ï¼šç¼“å­˜æ•°æ®å’Œä¸´æ—¶å¯¹è±¡
- **IOç­‰å¾…**ï¼šæ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè°ƒç”¨
- **ä¸å¯ç¼“å­˜**ï¼šæ¯æ¬¡è¯·æ±‚ç»“æœå¯èƒ½ä¸åŒ

### 6.2 æµ‹è¯•ç¯å¢ƒæ­å»º


**ğŸ”§ PHPåŠ¨æ€é¡µé¢ç¤ºä¾‹**
```php
<?php
// åˆ›å»ºæ–‡ä»¶ï¼š/var/www/dynamic-test/simple.php
header('Content-Type: application/json');

// æ¨¡æ‹Ÿç®€å•è®¡ç®—
$start = microtime(true);
$result = 0;
for ($i = 0; $i < 10000; $i++) {
    $result += sqrt($i);
}
$end = microtime(true);

echo json_encode([
    'timestamp' => time(),
    'calculation_result' => round($result, 2),
    'processing_time' => round(($end - $start) * 1000, 2) . 'ms',
    'server_load' => sys_getloadavg()[0]
]);
?>
```

**ğŸ—„ï¸ æ•°æ®åº“æŸ¥è¯¢é¡µé¢**
```php
<?php
// åˆ›å»ºæ–‡ä»¶ï¼š/var/www/dynamic-test/database.php
$pdo = new PDO('mysql:host=localhost;dbname=test', 'user', 'password');

$start = microtime(true);

// æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
$stmt = $pdo->query('SELECT * FROM users ORDER BY RAND() LIMIT 10');
$users = $stmt->fetchAll(PDO::FETCH_ASSOC);

$end = microtime(true);

header('Content-Type: application/json');
echo json_encode([
    'users_count' => count($users),
    'query_time' => round(($end - $start) * 1000, 2) . 'ms',
    'timestamp' => date('Y-m-d H:i:s')
]);
?>
```

### 6.3 è®¡ç®—å¯†é›†å‹æµ‹è¯•


**âš™ï¸ CPUè®¡ç®—æ€§èƒ½æµ‹è¯•**
```bash
# æµ‹è¯•ç®€å•è®¡ç®—é¡µé¢
wrk -t4 -c50 -d30s --latency http://localhost/dynamic-test/simple.php

# å¯¹æ¯”ä¸åŒè®¡ç®—å¤æ‚åº¦
echo "=== è®¡ç®—å¯†é›†å‹æ€§èƒ½æµ‹è¯• ==="

echo "è½»é‡è®¡ç®—ï¼ˆ1000æ¬¡å¾ªç¯ï¼‰:"
wrk -t2 -c20 -d10s http://localhost/light-calc.php | grep -E "(Requests/sec|Latency)"

echo "ä¸­ç­‰è®¡ç®—ï¼ˆ10000æ¬¡å¾ªç¯ï¼‰:"  
wrk -t2 -c20 -d10s http://localhost/medium-calc.php | grep -E "(Requests/sec|Latency)"

echo "é‡åº¦è®¡ç®—ï¼ˆ100000æ¬¡å¾ªç¯ï¼‰:"
wrk -t2 -c20 -d10s http://localhost/heavy-calc.php | grep -E "(Requests/sec|Latency)"
```

### 6.4 æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½æµ‹è¯•


**ğŸ—„ï¸ æ•°æ®åº“è´Ÿè½½æµ‹è¯•**
```bash
# æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
wrk -t8 -c100 -d60s --latency http://localhost/dynamic-test/database.php

# ç›‘æ§æ•°æ®åº“æ€§èƒ½
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œï¼š
watch -n 1 'mysqladmin processlist | wc -l; mysqladmin status | grep -E "(Uptime|Threads|Questions)"'
```

**ğŸ“Š æŸ¥è¯¢å¤æ‚åº¦å¯¹æ¯”**
```bash
#!/bin/bash
# æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”è„šæœ¬

echo "=== æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½æµ‹è¯• ==="

echo "ç®€å•æŸ¥è¯¢ (SELECT COUNT(*)):"
wrk -t4 -c50 -d15s http://localhost/simple-query.php | grep "Requests/sec"

echo "å¤æ‚æŸ¥è¯¢ (JOIN + GROUP BY):"
wrk -t4 -c50 -d15s http://localhost/complex-query.php | grep "Requests/sec"

echo "æ‰¹é‡æŸ¥è¯¢ (æŸ¥è¯¢100æ¡è®°å½•):"
wrk -t4 -c50 -d15s http://localhost/batch-query.php | grep "Requests/sec"
```

### 6.5 APIæ¥å£æ€§èƒ½æµ‹è¯•


**ğŸ”Œ RESTful APIæµ‹è¯•**
```bash
# GETè¯·æ±‚æµ‹è¯•
wrk -t6 -c100 -d30s --latency http://api.example.com/users

# POSTè¯·æ±‚æµ‹è¯•  
wrk -t6 -c100 -d30s \
    -s post-script.lua \
    http://api.example.com/users

# post-script.luaå†…å®¹ï¼š
wrk.method = "POST"
wrk.body = '{"name":"testuser","email":"test@example.com"}'
wrk.headers["Content-Type"] = "application/json"
```

**ğŸ”„ æ··åˆAPIæµ‹è¯•**
```lua
-- åˆ›å»ºæ–‡ä»¶ï¼šapi-mix.lua
local requests = {
    {"GET", "/api/users"},
    {"GET", "/api/products"},
    {"POST", "/api/orders", '{"user_id":1,"product_id":2}'},
    {"PUT", "/api/users/1", '{"name":"updated"}'},
}

local counter = 0

function request()
    counter = counter + 1
    local req = requests[(counter % #requests) + 1]
    local method, path, body = req[1], req[2], req[3]
    
    if body then
        wrk.headers["Content-Type"] = "application/json"
        return wrk.format(method, path, nil, body)
    else
        return wrk.format(method, path)
    end
end
```

```bash
# æ‰§è¡Œæ··åˆAPIæµ‹è¯•
wrk -t8 -c200 -d60s -s api-mix.lua http://api.example.com
```

### 6.6 æ€§èƒ½ç“¶é¢ˆåˆ†æ


**ğŸ” èµ„æºä½¿ç”¨ç›‘æ§**
```bash
# åœ¨æµ‹è¯•æœŸé—´ç›‘æ§ç³»ç»Ÿèµ„æº
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šmonitor.sh

echo "å¼€å§‹ç›‘æ§ç³»ç»Ÿèµ„æº..."
echo "æ—¶é—´,CPU%,å†…å­˜%,è´Ÿè½½" > performance.csv

while true; do
    timestamp=$(date '+%H:%M:%S')
    cpu=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    memory=$(free | grep Mem | awk '{printf "%.1f", ($3/$2) * 100.0}')
    load=$(uptime | awk -F'load average:' '{print $2}' | cut -d',' -f1 | xargs)
    
    echo "$timestamp,$cpu,$memory,$load" >> performance.csv
    echo "[$timestamp] CPU: $cpu%, å†…å­˜: $memory%, è´Ÿè½½: $load"
    
    sleep 5
done
```

**ğŸ“ˆ åŠ¨æ€å†…å®¹æ€§èƒ½åŸºå‡†**

| å†…å®¹ç±»å‹ | **æœŸæœ›QPS** | **æœŸæœ›å»¶è¿Ÿ** | **CPUä½¿ç”¨ç‡** |
|---------|------------|-------------|-------------|
| **ç®€å•è®¡ç®—** | 500-2000 | < 50ms | < 70% |
| **æ•°æ®åº“æŸ¥è¯¢** | 100-1000 | < 200ms | < 60% |
| **å¤æ‚ä¸šåŠ¡é€»è¾‘** | 50-500 | < 500ms | < 80% |
| **æ–‡ä»¶æ“ä½œ** | 100-800 | < 300ms | < 50% |

> ğŸ’¡ **ä¼˜åŒ–å»ºè®®**ï¼šåŠ¨æ€å†…å®¹çš„æ€§èƒ½ä¼˜åŒ–é‡ç‚¹åœ¨äºå‡å°‘æ•°æ®åº“æŸ¥è¯¢ã€ä½¿ç”¨ç¼“å­˜ã€ä¼˜åŒ–ç®—æ³•å¤æ‚åº¦å’Œåˆç†çš„å¹¶å‘æ§åˆ¶ã€‚

---

## 7. ğŸ‘¥ å¹¶å‘ç”¨æˆ·æ•°å‹åŠ›æµ‹è¯•


### 7.1 å¹¶å‘æµ‹è¯•åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å¹¶å‘ç”¨æˆ·æ•°**ï¼š
å¹¶å‘ç”¨æˆ·æ•°æ˜¯æŒ‡**åŒä¸€æ—¶åˆ»æ­£åœ¨è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·æ•°é‡**ï¼Œå°±åƒç”µæ¢¯çš„è½½é‡é‡ï¼Œéœ€è¦æµ‹è¯•ç³»ç»Ÿèƒ½åŒæ—¶ä¸ºå¤šå°‘ç”¨æˆ·æä¾›æ­£å¸¸æœåŠ¡ã€‚

**å¹¶å‘ç±»å‹åŒºåˆ†**ï¼š
- **ç†è®ºå¹¶å‘**ï¼šç³»ç»Ÿè®¾è®¡æ”¯æŒçš„æœ€å¤§å¹¶å‘æ•°
- **å®é™…å¹¶å‘**ï¼šæµ‹è¯•ä¸­çœŸæ­£åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°
- **å³°å€¼å¹¶å‘**ï¼šçŸ­æ—¶é—´å†…çš„æœ€é«˜å¹¶å‘æ•°
- **å¹³å‡å¹¶å‘**ï¼šä¸€æ®µæ—¶é—´å†…çš„å¹³å‡å¹¶å‘æ•°

### 7.2 å¹¶å‘æµ‹è¯•ç­–ç•¥


**ğŸ“ˆ æ¸è¿›å¼å‹åŠ›æµ‹è¯•**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šconcurrent-test.sh
# æ¸è¿›å¼å¹¶å‘æµ‹è¯•è„šæœ¬

URL="http://localhost"
TEST_DURATION="30s"

echo "=== æ¸è¿›å¼å¹¶å‘å‹åŠ›æµ‹è¯• ==="
echo "ç›®æ ‡URL: $URL"
echo "æ¯è½®æµ‹è¯•æ—¶é•¿: $TEST_DURATION"
echo ""

# å®šä¹‰å¹¶å‘çº§åˆ«
CONCURRENT_LEVELS=(10 25 50 100 200 500 1000)

for CONCURRENT in "${CONCURRENT_LEVELS[@]}"; do
    echo "--- æµ‹è¯•å¹¶å‘æ•°: $CONCURRENT ---"
    
    # è®¡ç®—åˆé€‚çš„çº¿ç¨‹æ•°ï¼ˆé€šå¸¸ä¸ºå¹¶å‘æ•°çš„1/4åˆ°1/8ï¼‰
    THREADS=$((CONCURRENT / 8))
    if [ $THREADS -lt 1 ]; then
        THREADS=1
    fi
    
    echo "ä½¿ç”¨çº¿ç¨‹æ•°: $THREADS"
    
    # æ‰§è¡Œæµ‹è¯•å¹¶æå–å…³é”®æŒ‡æ ‡
    RESULT=$(wrk -t$THREADS -c$CONCURRENT -d$TEST_DURATION --latency $URL 2>/dev/null)
    
    QPS=$(echo "$RESULT" | grep "Requests/sec" | awk '{print $2}')
    AVG_LATENCY=$(echo "$RESULT" | grep "Latency" | head -1 | awk '{print $2}')
    P99_LATENCY=$(echo "$RESULT" | grep "99%" | awk '{print $2}')
    
    echo "QPS: $QPS"
    echo "å¹³å‡å»¶è¿Ÿ: $AVG_LATENCY" 
    echo "99%å»¶è¿Ÿ: $P99_LATENCY"
    echo "---------------------"
    echo ""
    
    # è®°å½•åˆ°CSVæ–‡ä»¶
    echo "$CONCURRENT,$QPS,$AVG_LATENCY,$P99_LATENCY" >> concurrent-results.csv
    
    # çŸ­æš‚ä¼‘æ¯ï¼Œè®©ç³»ç»Ÿæ¢å¤
    sleep 10
done

echo "æµ‹è¯•å®Œæˆï¼ç»“æœå·²ä¿å­˜åˆ° concurrent-results.csv"
```

### 7.3 é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•


**â° æŒç»­è´Ÿè½½æµ‹è¯•**
```bash
# é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯• (1å°æ—¶)
wrk -t8 -c200 -d1h --latency http://localhost > stability-test.log 2>&1 &

# åå°ç›‘æ§ç³»ç»Ÿèµ„æº
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šstability-monitor.sh

LOG_FILE="stability-monitor.log"
echo "æ—¶é—´,CPU%,å†…å­˜ä½¿ç”¨MB,è´Ÿè½½1åˆ†é’Ÿ,è´Ÿè½½5åˆ†é’Ÿ,ç½‘ç»œè¿æ¥æ•°" > $LOG_FILE

while true; do
    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
    
    # CPUä½¿ç”¨ç‡
    CPU=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    
    # å†…å­˜ä½¿ç”¨é‡(MB)
    MEMORY=$(free -m | grep Mem | awk '{print $3}')
    
    # ç³»ç»Ÿè´Ÿè½½
    LOAD1=$(uptime | awk -F'load average:' '{print $2}' | cut -d',' -f1 | xargs)
    LOAD5=$(uptime | awk -F'load average:' '{print $2}' | cut -d',' -f2 | xargs)
    
    # ç½‘ç»œè¿æ¥æ•°
    CONNECTIONS=$(ss -tun | wc -l)
    
    echo "$TIMESTAMP,$CPU,$MEMORY,$LOAD1,$LOAD5,$CONNECTIONS" >> $LOG_FILE
    
    sleep 60  # æ¯åˆ†é’Ÿè®°å½•ä¸€æ¬¡
done
```

### 7.4 çªå‘æµé‡æµ‹è¯•


**âš¡ æµé‡çªå‘æ¨¡æ‹Ÿ**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šspike-test.sh
# æ¨¡æ‹Ÿçªå‘æµé‡æµ‹è¯•

URL="http://localhost"

echo "=== çªå‘æµé‡æµ‹è¯• ==="

# æ­£å¸¸è´Ÿè½½åŸºçº¿
echo "1. å»ºç«‹æ­£å¸¸è´Ÿè½½åŸºçº¿ (50å¹¶å‘, 60ç§’)"
wrk -t4 -c50 -d60s $URL > baseline.log &
BASELINE_PID=$!

sleep 30  # ç­‰å¾…ç³»ç»Ÿè¿›å…¥ç¨³å®šçŠ¶æ€

# çªå‘æµé‡å†²å‡»
echo "2. å‘èµ·çªå‘æµé‡å†²å‡» (500å¹¶å‘, 30ç§’)"
wrk -t12 -c500 -d30s --latency $URL > spike.log &
SPIKE_PID=$!

# ç­‰å¾…çªå‘æµ‹è¯•å®Œæˆ
wait $SPIKE_PID

echo "3. è§‚å¯Ÿç³»ç»Ÿæ¢å¤æƒ…å†µ (ç»§ç»­åŸºçº¿æµ‹è¯•30ç§’)"
sleep 30

# ç»“æŸåŸºçº¿æµ‹è¯•
kill $BASELINE_PID 2>/dev/null

echo "çªå‘æµé‡æµ‹è¯•å®Œæˆ"
echo "åŸºçº¿æµ‹è¯•ç»“æœä¿å­˜åœ¨: baseline.log"  
echo "çªå‘æµ‹è¯•ç»“æœä¿å­˜åœ¨: spike.log"
```

### 7.5 å¹¶å‘æ€§èƒ½åˆ†æ


**ğŸ“Š å¹¶å‘èƒ½åŠ›è¯„ä¼°**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šanalyze-concurrent.sh
# åˆ†æå¹¶å‘æµ‹è¯•ç»“æœ

if [ ! -f "concurrent-results.csv" ]; then
    echo "é”™è¯¯ï¼šæ‰¾ä¸åˆ°æµ‹è¯•ç»“æœæ–‡ä»¶ concurrent-results.csv"
    exit 1
fi

echo "=== å¹¶å‘æ€§èƒ½åˆ†ææŠ¥å‘Š ==="
echo ""

# æ‰¾åˆ°æœ€ä½³å¹¶å‘æ•°ï¼ˆQPSæœ€é«˜ç‚¹ï¼‰
BEST_CONCURRENT=$(awk -F',' 'NR>1 {print $1 "," $2}' concurrent-results.csv | sort -t',' -k2 -nr | head -1 | cut -d',' -f1)
BEST_QPS=$(awk -F',' 'NR>1 {print $1 "," $2}' concurrent-results.csv | sort -t',' -k2 -nr | head -1 | cut -d',' -f2)

echo "ğŸ† æœ€ä½³å¹¶å‘æ•°: $BEST_CONCURRENT"
echo "ğŸš€ æœ€é«˜QPS: $BEST_QPS"
echo ""

# æ‰¾åˆ°å»¶è¿Ÿæ‹ç‚¹ï¼ˆ99%å»¶è¿Ÿè¶…è¿‡100msçš„æœ€å°å¹¶å‘æ•°ï¼‰
LATENCY_THRESHOLD=$(awk -F',' 'NR>1 && $4 > 100 {print $1}' concurrent-results.csv | head -1)

if [ ! -z "$LATENCY_THRESHOLD" ]; then
    echo "âš ï¸  å»¶è¿Ÿæ‹ç‚¹: å¹¶å‘æ•° $LATENCY_THRESHOLD (99%å»¶è¿Ÿ > 100ms)"
else
    echo "âœ… å»¶è¿Ÿè¡¨ç°è‰¯å¥½: æ‰€æœ‰æµ‹è¯•ä¸­99%å»¶è¿Ÿéƒ½ < 100ms"
fi

echo ""
echo "ğŸ“‹ è¯¦ç»†æµ‹è¯•ç»“æœ:"
echo "å¹¶å‘æ•°,QPS,å¹³å‡å»¶è¿Ÿ,99%å»¶è¿Ÿ"
cat concurrent-results.csv
```

### 7.6 å¹¶å‘æµ‹è¯•æœ€ä½³å®è·µ


**âœ… æµ‹è¯•æ‰§è¡Œè¦ç‚¹**
```
å¹¶å‘æµ‹è¯•æ³¨æ„äº‹é¡¹ï¼š

æµ‹è¯•ç¯å¢ƒè¦æ±‚ï¼š
â”œâ”€â”€ ç‹¬ç«‹æµ‹è¯•ç¯å¢ƒï¼šé¿å…å…¶ä»–æœåŠ¡å½±å“
â”œâ”€â”€ è¶³å¤Ÿçš„æµ‹è¯•æœºèµ„æºï¼šé˜²æ­¢æµ‹è¯•å·¥å…·æˆä¸ºç“¶é¢ˆ  
â”œâ”€â”€ ç½‘ç»œå¸¦å®½å……è¶³ï¼šç¡®ä¿ç½‘ç»œä¸æ˜¯ç“¶é¢ˆ
â””â”€â”€ ç›‘æ§å®Œæ•´ï¼šCPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜å…¨æ–¹ä½ç›‘æ§

æµ‹è¯•ç­–ç•¥ï¼š
â”œâ”€â”€ æ¸è¿›å¼åŠ å‹ï¼šä»å°å¹¶å‘å¼€å§‹é€æ­¥å¢åŠ 
â”œâ”€â”€ å……åˆ†é¢„çƒ­ï¼šæ¯è½®æµ‹è¯•å‰è®©ç³»ç»Ÿè¾¾åˆ°ç¨³å®šçŠ¶æ€
â”œâ”€â”€ å¤šè½®éªŒè¯ï¼šé‡å¤æµ‹è¯•ç¡®ä¿ç»“æœå¯é æ€§
â””â”€â”€ å¼‚å¸¸å¤„ç†ï¼šå…³æ³¨é”™è¯¯ç‡å’Œè¶…æ—¶æƒ…å†µ

ç»“æœåˆ†æï¼š
â”œâ”€â”€ å…³æ³¨æ‹ç‚¹ï¼šæ‰¾åˆ°æ€§èƒ½æ€¥å‰§ä¸‹é™çš„å¹¶å‘æ•°
â”œâ”€â”€ ç»¼åˆè¯„ä¼°ï¼šä¸åªçœ‹QPSï¼Œè¿˜è¦çœ‹å»¶è¿Ÿå’Œç¨³å®šæ€§
â”œâ”€â”€ ä¸šåŠ¡ç›¸å…³ï¼šç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯ç¡®å®šåˆç†å¹¶å‘æ•°
â””â”€â”€ ç•™æœ‰ä½™é‡ï¼šç”Ÿäº§ç¯å¢ƒä¿ç•™20-30%çš„æ€§èƒ½ä½™é‡
```

> ğŸ¯ **å…³é”®æŒ‡æ ‡**ï¼šæ‰¾åˆ°ç³»ç»Ÿçš„"ç”œèœœç‚¹" - æ—¢èƒ½ç»´æŒé«˜QPSï¼Œåˆèƒ½ä¿è¯åˆç†å»¶è¿Ÿçš„æœ€ä½³å¹¶å‘æ•°ã€‚

---

## 8. ğŸ”— é•¿è¿æ¥æ€§èƒ½æµ‹è¯•


### 8.1 é•¿è¿æ¥åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯é•¿è¿æ¥**ï¼š
é•¿è¿æ¥å°±æ˜¯**å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥åä¿æŒä¸æ–­å¼€**ï¼Œå¯ä»¥è¿ç»­å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå°±åƒå¼€é€šäº†ä¸€æ¡ä¸“ç”¨é€šé“ï¼Œé¿å…äº†é¢‘ç¹çš„"é€šè¯å»ºç«‹"å’Œ"æŒ‚æ–­"è¿‡ç¨‹ã€‚

**é•¿è¿æ¥vsçŸ­è¿æ¥å¯¹æ¯”**ï¼š
```
çŸ­è¿æ¥æ¨¡å¼ï¼š
å®¢æˆ·ç«¯ â”€â”€å»ºç«‹è¿æ¥â”€â”€> æœåŠ¡å™¨
å®¢æˆ·ç«¯ <â”€â”€å‘é€æ•°æ®â”€â”€â”€â”€ æœåŠ¡å™¨  
å®¢æˆ·ç«¯ â”€â”€æ¥æ”¶æ•°æ®â”€â”€> æœåŠ¡å™¨
å®¢æˆ·ç«¯ â”€â”€æ–­å¼€è¿æ¥â”€â”€> æœåŠ¡å™¨
(æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡å¤è¿™ä¸ªè¿‡ç¨‹)

é•¿è¿æ¥æ¨¡å¼ï¼š
å®¢æˆ·ç«¯ â”€â”€å»ºç«‹è¿æ¥â”€â”€> æœåŠ¡å™¨
å®¢æˆ·ç«¯ <â”€â”€å‘é€æ•°æ®1â”€â”€â”€ æœåŠ¡å™¨
å®¢æˆ·ç«¯ <â”€â”€å‘é€æ•°æ®2â”€â”€â”€ æœåŠ¡å™¨  
å®¢æˆ·ç«¯ <â”€â”€å‘é€æ•°æ®Nâ”€â”€â”€ æœåŠ¡å™¨
å®¢æˆ·ç«¯ â”€â”€æ–­å¼€è¿æ¥â”€â”€> æœåŠ¡å™¨
(ä¸€æ¬¡è¿æ¥ï¼Œå¤šæ¬¡å¤ç”¨)
```

### 8.2 HTTP Keep-Aliveæµ‹è¯•


**ğŸ”§ Keep-Aliveé…ç½®**
```nginx
# Nginx Keep-Aliveé…ç½®
http {
    keepalive_timeout 65;           # è¿æ¥ä¿æŒæ—¶é—´
    keepalive_requests 1000;        # å•è¿æ¥æœ€å¤§è¯·æ±‚æ•°
    
    upstream backend {
        server 127.0.0.1:8080;
        keepalive 32;               # ä¸Šæ¸¸è¿æ¥æ± å¤§å°
    }
    
    server {
        listen 80;
        
        location / {
            proxy_pass http://backend;
            proxy_http_version 1.1;
            proxy_set_header Connection "";  # æ¸…é™¤Connectionå¤´
        }
    }
}
```

**âš¡ Keep-Aliveæ€§èƒ½æµ‹è¯•**
```bash
# å¯¹æ¯”çŸ­è¿æ¥å’Œé•¿è¿æ¥æ€§èƒ½
echo "=== Keep-Aliveæ€§èƒ½å¯¹æ¯”æµ‹è¯• ==="

echo "1. çŸ­è¿æ¥æµ‹è¯• (æ¯æ¬¡è¯·æ±‚éƒ½å»ºç«‹æ–°è¿æ¥):"
wrk -t4 -c100 -d30s http://localhost/test.html

echo ""
echo "2. é•¿è¿æ¥æµ‹è¯• (å¯ç”¨Keep-Alive):"
wrk -t4 -c100 -d30s -H "Connection: keep-alive" http://localhost/test.html

echo ""
echo "3. ä½¿ç”¨abå·¥å…·å¯¹æ¯”:"
echo "çŸ­è¿æ¥:"
ab -n 1000 -c 50 http://localhost/test.html | grep -E "(Requests per second|Time per request)"

echo "é•¿è¿æ¥:"  
ab -n 1000 -c 50 -k http://localhost/test.html | grep -E "(Requests per second|Time per request)"
```

### 8.3 WebSocketé•¿è¿æ¥æµ‹è¯•


**ğŸ”Œ WebSocketæœåŠ¡å™¨ç¤ºä¾‹**
```javascript
// åˆ›å»ºæ–‡ä»¶ï¼šwebsocket-server.js
const WebSocket = require('ws');
const http = require('http');

const server = http.createServer();
const wss = new WebSocket.Server({ server });

let clientCount = 0;
let messageCount = 0;

wss.on('connection', function connection(ws) {
    clientCount++;
    console.log(`å®¢æˆ·ç«¯è¿æ¥ï¼Œå½“å‰è¿æ¥æ•°: ${clientCount}`);
    
    // å‘é€æ¬¢è¿æ¶ˆæ¯
    ws.send(JSON.stringify({
        type: 'welcome',
        message: 'è¿æ¥æˆåŠŸ',
        timestamp: Date.now()
    }));
    
    ws.on('message', function incoming(message) {
        messageCount++;
        
        // å›æ˜¾æ¶ˆæ¯
        ws.send(JSON.stringify({
            type: 'echo', 
            data: message.toString(),
            messageId: messageCount,
            timestamp: Date.now()
        }));
    });
    
    ws.on('close', function close() {
        clientCount--;
        console.log(`å®¢æˆ·ç«¯æ–­å¼€ï¼Œå½“å‰è¿æ¥æ•°: ${clientCount}`);
    });
});

server.listen(8080, () => {
    console.log('WebSocketæœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 8080');
});
```

**ğŸ“Š WebSocketå‹åŠ›æµ‹è¯•å·¥å…·**
```javascript
// åˆ›å»ºæ–‡ä»¶ï¼šwebsocket-client.js
const WebSocket = require('ws');

class WebSocketTester {
    constructor(url, options = {}) {
        this.url = url;
        this.concurrency = options.concurrency || 100;
        this.duration = options.duration || 30000;
        this.messageInterval = options.messageInterval || 1000;
        
        this.connections = [];
        this.stats = {
            connected: 0,
            messages_sent: 0,
            messages_received: 0,
            errors: 0
        };
    }
    
    async start() {
        console.log(`å¼€å§‹WebSocketå‹åŠ›æµ‹è¯•:`);
        console.log(`- å¹¶å‘è¿æ¥æ•°: ${this.concurrency}`);
        console.log(`- æµ‹è¯•æ—¶é•¿: ${this.duration}ms`);
        console.log(`- æ¶ˆæ¯é—´éš”: ${this.messageInterval}ms`);
        
        // å»ºç«‹è¿æ¥
        for (let i = 0; i < this.concurrency; i++) {
            this.createConnection(i);
        }
        
        // å®šæœŸè¾“å‡ºç»Ÿè®¡
        const statsInterval = setInterval(() => {
            this.printStats();
        }, 5000);
        
        // æµ‹è¯•ç»“æŸ
        setTimeout(() => {
            clearInterval(statsInterval);
            this.cleanup();
        }, this.duration);
    }
    
    createConnection(id) {
        const ws = new WebSocket(this.url);
        
        ws.on('open', () => {
            this.stats.connected++;
            
            // å®šæœŸå‘é€æ¶ˆæ¯
            const sendInterval = setInterval(() => {
                if (ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        clientId: id,
                        message: `æµ‹è¯•æ¶ˆæ¯ ${Date.now()}`,
                        timestamp: Date.now()
                    }));
                    this.stats.messages_sent++;
                }
            }, this.messageInterval);
            
            ws.sendInterval = sendInterval;
        });
        
        ws.on('message', (data) => {
            this.stats.messages_received++;
        });
        
        ws.on('error', (error) => {
            this.stats.errors++;
        });
        
        ws.on('close', () => {
            this.stats.connected--;
            if (ws.sendInterval) {
                clearInterval(ws.sendInterval);
            }
        });
        
        this.connections.push(ws);
    }
    
    printStats() {
        console.log('--- WebSocketç»Ÿè®¡ ---');
        console.log(`è¿æ¥æ•°: ${this.stats.connected}`);
        console.log(`å‘é€æ¶ˆæ¯: ${this.stats.messages_sent}`);
        console.log(`æ¥æ”¶æ¶ˆæ¯: ${this.stats.messages_received}`);
        console.log(`é”™è¯¯æ•°: ${this.stats.errors}`);
        console.log('--------------------');
    }
    
    cleanup() {
        console.log('æ¸…ç†è¿æ¥...');
        this.connections.forEach(ws => {
            if (ws.sendInterval) {
                clearInterval(ws.sendInterval);
            }
            ws.close();
        });
        
        this.printStats();
        console.log('æµ‹è¯•å®Œæˆ');
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const tester = new WebSocketTester('ws://localhost:8080', {
    concurrency: 500,
    duration: 60000,
    messageInterval: 2000
});

tester.start();
```

### 8.4 TCPé•¿è¿æ¥æµ‹è¯•


**ğŸ”— TCPè¿æ¥æ± æµ‹è¯•**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼štcp-connection-test.sh
# TCPé•¿è¿æ¥å‹åŠ›æµ‹è¯•

TARGET_HOST="localhost"
TARGET_PORT="80"
CONCURRENT_CONNECTIONS=1000
TEST_DURATION=60

echo "=== TCPé•¿è¿æ¥å‹åŠ›æµ‹è¯• ==="
echo "ç›®æ ‡: $TARGET_HOST:$TARGET_PORT"
echo "å¹¶å‘è¿æ¥æ•°: $CONCURRENT_CONNECTIONS"
echo "æµ‹è¯•æ—¶é•¿: ${TEST_DURATION}ç§’"

# ç›‘æ§è¿æ¥æ•°
monitor_connections() {
    while true; do
        ESTABLISHED=$(ss -tan | grep :$TARGET_PORT | grep ESTABLISHED | wc -l)
        TIME_WAIT=$(ss -tan | grep :$TARGET_PORT | grep TIME-WAIT | wc -l)
        echo "$(date '+%H:%M:%S') - ESTABLISHED: $ESTABLISHED, TIME-WAIT: $TIME_WAIT"
        sleep 5
    done
}

# å¯åŠ¨ç›‘æ§
monitor_connections &
MONITOR_PID=$!

# ä½¿ç”¨hping3æµ‹è¯•TCPè¿æ¥
echo "å¼€å§‹å»ºç«‹TCPè¿æ¥..."
timeout $TEST_DURATION hping3 -S -p $TARGET_PORT -c $CONCURRENT_CONNECTIONS $TARGET_HOST

# æ¸…ç†
kill $MONITOR_PID 2>/dev/null
echo "TCPè¿æ¥æµ‹è¯•å®Œæˆ"
```

### 8.5 è¿æ¥æ± æ€§èƒ½ä¼˜åŒ–


**ğŸ“Š è¿æ¥æ± é…ç½®å¯¹æ¯”**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šconnection-pool-test.sh

echo "=== è¿æ¥æ± é…ç½®æ€§èƒ½å¯¹æ¯” ==="

# æµ‹è¯•ä¸åŒçš„Keep-Aliveè®¾ç½®
test_keepalive_setting() {
    local timeout=$1
    local requests=$2
    
    echo "æµ‹è¯• Keep-Alive: timeout=${timeout}s, max_requests=${requests}"
    
    # ä¸´æ—¶ä¿®æ”¹Nginxé…ç½®ï¼ˆéœ€è¦sudoæƒé™ï¼‰
    sudo sed -i "s/keepalive_timeout.*/keepalive_timeout ${timeout};/" /etc/nginx/nginx.conf
    sudo sed -i "s/keepalive_requests.*/keepalive_requests ${requests};/" /etc/nginx/nginx.conf
    
    # é‡è½½é…ç½®
    sudo nginx -s reload
    sleep 2
    
    # æ‰§è¡Œæµ‹è¯•
    RESULT=$(wrk -t4 -c100 -d15s -H "Connection: keep-alive" http://localhost/ 2>/dev/null)
    QPS=$(echo "$RESULT" | grep "Requests/sec" | awk '{print $2}')
    
    echo "QPS: $QPS"
    echo "---"
}

# æµ‹è¯•ä¸åŒé…ç½®
test_keepalive_setting 10 100
test_keepalive_setting 30 500  
test_keepalive_setting 65 1000
test_keepalive_setting 120 2000

echo "æµ‹è¯•å®Œæˆï¼Œè¯·æ£€æŸ¥æœ€ä½³é…ç½®"
```

### 8.6 é•¿è¿æ¥æ€§èƒ½åˆ†æ


**ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”**

| è¿æ¥ç±»å‹ | **QPSæå‡** | **å»¶è¿Ÿé™ä½** | **èµ„æºæ¶ˆè€—** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|-------------|-------------|-------------|
| **çŸ­è¿æ¥** | åŸºå‡† | åŸºå‡† | ä½ | ä½é¢‘è®¿é—®ã€ç®€å•è¯·æ±‚ |
| **HTTP Keep-Alive** | 20-50% | 30-60% | ä¸­ç­‰ | Webç½‘ç«™ã€APIæœåŠ¡ |
| **WebSocket** | 100-300% | 70-90% | é«˜ | å®æ—¶é€šä¿¡ã€æ¨é€æœåŠ¡ |
| **TCPè¿æ¥æ± ** | 50-150% | 40-80% | é«˜ | æ•°æ®åº“è¿æ¥ã€å¾®æœåŠ¡ |

**ğŸ” ä¼˜åŒ–å»ºè®®**
```
é•¿è¿æ¥ä¼˜åŒ–ç­–ç•¥ï¼š

é…ç½®ä¼˜åŒ–ï¼š
â”œâ”€â”€ åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ï¼šå¹³è¡¡èµ„æºå ç”¨å’Œæ€§èƒ½
â”œâ”€â”€ æ§åˆ¶æœ€å¤§è¯·æ±‚æ•°ï¼šé˜²æ­¢è¿æ¥è¿‡åº¦å¤ç”¨
â”œâ”€â”€ é…ç½®è¿æ¥æ± å¤§å°ï¼šæ ¹æ®å¹¶å‘éœ€æ±‚è°ƒæ•´
â””â”€â”€ ç›‘æ§è¿æ¥çŠ¶æ€ï¼šåŠæ—¶å‘ç°å¼‚å¸¸è¿æ¥

åº”ç”¨å±‚ä¼˜åŒ–ï¼š
â”œâ”€â”€ å®¢æˆ·ç«¯è¿æ¥å¤ç”¨ï¼šé¿å…é¢‘ç¹å»ºè¿
â”œâ”€â”€ å¿ƒè·³æœºåˆ¶ï¼šä¿æŒè¿æ¥æ´»è·ƒçŠ¶æ€  
â”œâ”€â”€ ä¼˜é›…å…³é—­ï¼šæ­£ç¡®å¤„ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸ
â””â”€â”€ é”™è¯¯é‡è¯•ï¼šç½‘ç»œå¼‚å¸¸æ—¶çš„é‡è¿æœºåˆ¶

ç›‘æ§æŒ‡æ ‡ï¼š
â”œâ”€â”€ è¿æ¥æ•°ç»Ÿè®¡ï¼šESTABLISHEDã€TIME-WAITçŠ¶æ€
â”œâ”€â”€ è¿æ¥å¤ç”¨ç‡ï¼šå¹³å‡æ¯è¿æ¥å¤„ç†çš„è¯·æ±‚æ•°
â”œâ”€â”€ è¿æ¥é”™è¯¯ç‡ï¼šè¿æ¥å¤±è´¥ã€è¶…æ—¶çš„æ¯”ä¾‹
â””â”€â”€ èµ„æºæ¶ˆè€—ï¼šå†…å­˜ã€æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨æƒ…å†µ
```

> ğŸ’¡ **å®è·µè¦ç‚¹**ï¼šé•¿è¿æ¥èƒ½æ˜¾è‘—æå‡æ€§èƒ½ï¼Œä½†è¦æ³¨æ„èµ„æºæ¶ˆè€—å’Œè¿æ¥ç®¡ç†ï¼Œåˆç†é…ç½®è¶…æ—¶å’Œè¿æ¥æ± å‚æ•°ã€‚

---

## 9. ğŸ”’ HTTPSæ€§èƒ½å½±å“æµ‹è¯•


### 9.1 HTTPSæ€§èƒ½å½±å“æ¦‚è¿°


**HTTPSå¸¦æ¥çš„æ€§èƒ½å¼€é”€**ï¼š
HTTPSç›¸æ¯”HTTPä¸»è¦å¢åŠ äº†**SSL/TLSåŠ å¯†å¤„ç†**ï¼Œå°±åƒåœ¨é‚®ä»¶ä¸ŠåŠ äº†ä¸€æŠŠé”ï¼Œè™½ç„¶æ›´å®‰å…¨ï¼Œä½†éœ€è¦é¢å¤–çš„"åŠ é”"å’Œ"è§£é”"æ—¶é—´ã€‚

**ä¸»è¦æ€§èƒ½å½±å“å› ç´ **ï¼š
- **æ¡æ‰‹å¼€é”€**ï¼šSSLæ¡æ‰‹éœ€è¦é¢å¤–çš„ç½‘ç»œå¾€è¿”
- **åŠ å¯†è®¡ç®—**ï¼šCPUéœ€è¦è¿›è¡ŒåŠ è§£å¯†è¿ç®—
- **è¯ä¹¦éªŒè¯**ï¼šå®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„æ—¶é—´
- **ä¼šè¯å¤ç”¨**ï¼šæ˜¯å¦èƒ½å¤ç”¨ä¹‹å‰çš„SSLä¼šè¯

### 9.2 HTTP vs HTTPSæ€§èƒ½å¯¹æ¯”


**ğŸ”§ æµ‹è¯•ç¯å¢ƒå‡†å¤‡**
```bash
# å‡†å¤‡HTTPå’ŒHTTPSæµ‹è¯•ç¯å¢ƒ
# 1. HTTPæœåŠ¡ (ç«¯å£80)
# 2. HTTPSæœåŠ¡ (ç«¯å£443)

# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
echo "Hello World - Performance Test" > /var/www/html/test.txt

# ç¡®è®¤æœåŠ¡çŠ¶æ€
curl -I http://localhost/test.txt
curl -I https://localhost/test.txt
```

**âš¡ åŸºç¡€æ€§èƒ½å¯¹æ¯”**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šhttp-vs-https.sh

echo "=== HTTP vs HTTPS æ€§èƒ½å¯¹æ¯”æµ‹è¯• ==="

# HTTPæµ‹è¯•
echo "1. HTTPæ€§èƒ½æµ‹è¯•:"
HTTP_RESULT=$(wrk -t4 -c100 -d30s http://localhost/test.txt 2>/dev/null)
HTTP_QPS=$(echo "$HTTP_RESULT" | grep "Requests/sec" | awk '{print $2}')
HTTP_LATENCY=$(echo "$HTTP_RESULT" | grep "Latency" | head -1 | awk '{print $2}')

echo "   QPS: $HTTP_QPS"
echo "   å¹³å‡å»¶è¿Ÿ: $HTTP_LATENCY"

# HTTPSæµ‹è¯•
echo ""
echo "2. HTTPSæ€§èƒ½æµ‹è¯•:"
HTTPS_RESULT=$(wrk -t4 -c100 -d30s https://localhost/test.txt 2>/dev/null)
HTTPS_QPS=$(echo "$HTTPS_RESULT" | grep "Requests/sec" | awk '{print $2}')
HTTPS_LATENCY=$(echo "$HTTPS_RESULT" | grep "Latency" | head -1 | awk '{print $2}')

echo "   QPS: $HTTPS_QPS"
echo "   å¹³å‡å»¶è¿Ÿ: $HTTPS_LATENCY"

# è®¡ç®—æ€§èƒ½å·®å¼‚
echo ""
echo "3. æ€§èƒ½å½±å“åˆ†æ:"
if command -v bc >/dev/null; then
    QPS_RATIO=$(echo "scale=2; $HTTPS_QPS / $HTTP_QPS * 100" | bc)
    echo "   HTTPS QPSç›¸å¯¹HTTP: ${QPS_RATIO}%"
    echo "   æ€§èƒ½æŸå¤±: $(echo "scale=2; 100 - $QPS_RATIO" | bc)%"
else
    echo "   éœ€è¦å®‰è£…bcå‘½ä»¤æ¥è®¡ç®—ç²¾ç¡®æ¯”ä¾‹"
fi
```

### 9.3 SSLæ¡æ‰‹æ€§èƒ½æµ‹è¯•


**ğŸ¤ SSLæ¡æ‰‹å»¶è¿Ÿæµ‹è¯•**
```bash
# æµ‹è¯•SSLæ¡æ‰‹æ—¶é—´
curl -w "@curl-ssl-format.txt" -o /dev/null -s https://localhost/test.txt

# curl-ssl-format.txtå†…å®¹ï¼š
      time_namelookup:  %{time_namelookup}\n
         time_connect:  %{time_connect}\n
      time_appconnect:  %{time_appconnect}\n
     time_pretransfer:  %{time_pretransfer}\n
        time_redirect:  %{time_redirect}\n
   time_starttransfer:  %{time_starttransfer}\n
                      ----------\n
           time_total:  %{time_total}\n
           
# å…³é”®æ—¶é—´è¯´æ˜ï¼š
# time_connect: TCPè¿æ¥å»ºç«‹æ—¶é—´
# time_appconnect: SSLæ¡æ‰‹å®Œæˆæ—¶é—´  
# SSLæ¡æ‰‹æ—¶é—´ = time_appconnect - time_connect
```

**ğŸ“Š å¤šæ¬¡æ¡æ‰‹æ€§èƒ½ç»Ÿè®¡**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šssl-handshake-test.sh

echo "=== SSLæ¡æ‰‹æ€§èƒ½ç»Ÿè®¡æµ‹è¯• ==="

HANDSHAKE_TIMES=()
TOTAL_TIMES=()

# æ‰§è¡Œ50æ¬¡æµ‹è¯•
for i in {1..50}; do
    RESULT=$(curl -w "%{time_connect},%{time_appconnect},%{time_total}" -o /dev/null -s https://localhost/test.txt)
    
    CONNECT_TIME=$(echo $RESULT | cut -d',' -f1)
    APPCONNECT_TIME=$(echo $RESULT | cut -d',' -f2) 
    TOTAL_TIME=$(echo $RESULT | cut -d',' -f3)
    
    # è®¡ç®—SSLæ¡æ‰‹æ—¶é—´
    HANDSHAKE_TIME=$(echo "$APPCONNECT_TIME - $CONNECT_TIME" | bc)
    
    HANDSHAKE_TIMES+=($HANDSHAKE_TIME)
    TOTAL_TIMES+=($TOTAL_TIME)
    
    echo "æµ‹è¯• $i: SSLæ¡æ‰‹=${HANDSHAKE_TIME}s, æ€»æ—¶é—´=${TOTAL_TIME}s"
done

# è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
echo ""
echo "=== ç»Ÿè®¡ç»“æœ ==="

# è®¡ç®—å¹³å‡SSLæ¡æ‰‹æ—¶é—´
AVG_HANDSHAKE=$(echo "${HANDSHAKE_TIMES[@]}" | tr ' ' '\n' | awk '{sum+=$1} END {printf "%.4f", sum/NR}')
echo "å¹³å‡SSLæ¡æ‰‹æ—¶é—´: ${AVG_HANDSHAKE}s"

# è®¡ç®—å¹³å‡æ€»æ—¶é—´
AVG_TOTAL=$(echo "${TOTAL_TIMES[@]}" | tr ' ' '\n' | awk '{sum+=$1} END {printf "%.4f", sum/NR}')
echo "å¹³å‡æ€»å“åº”æ—¶é—´: ${AVG_TOTAL}s"

# è®¡ç®—SSLå æ¯”
SSL_PERCENTAGE=$(echo "scale=2; $AVG_HANDSHAKE / $AVG_TOTAL * 100" | bc)
echo "SSLæ¡æ‰‹å æ€»æ—¶é—´æ¯”ä¾‹: ${SSL_PERCENTAGE}%"
```

### 9.4 SSLä¼šè¯å¤ç”¨æµ‹è¯•


**ğŸ”„ ä¼šè¯å¤ç”¨é…ç½®**
```nginx
# Nginx SSLä¼šè¯å¤ç”¨é…ç½®
server {
    listen 443 ssl;
    
    # SSLä¼šè¯ç¼“å­˜é…ç½®
    ssl_session_cache shared:SSL:10m;    # 10MBå…±äº«ç¼“å­˜
    ssl_session_timeout 10m;             # ä¼šè¯è¶…æ—¶10åˆ†é’Ÿ
    ssl_session_tickets on;              # å¯ç”¨ä¼šè¯ç¥¨æ®
    
    # SSLé…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
}
```

**ğŸ“ˆ ä¼šè¯å¤ç”¨æ•ˆæœæµ‹è¯•**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šssl-session-reuse-test.sh

echo "=== SSLä¼šè¯å¤ç”¨æ•ˆæœæµ‹è¯• ==="

# ç¦ç”¨ä¼šè¯å¤ç”¨çš„æµ‹è¯•
echo "1. ç¦ç”¨ä¼šè¯å¤ç”¨æµ‹è¯• (æ¯æ¬¡éƒ½è¦æ¡æ‰‹):"
wrk -t2 -c10 -d15s --latency https://localhost/test.txt

echo ""
echo "2. å¯ç”¨ä¼šè¯å¤ç”¨æµ‹è¯• (å¤ç”¨SSLä¼šè¯):"
# ä½¿ç”¨ç›¸åŒçš„è¿æ¥è¿›è¡Œå¤šæ¬¡è¯·æ±‚
curl -k --connect-timeout 10 -s https://localhost/test.txt > /dev/null
wrk -t2 -c10 -d15s --latency -H "Connection: keep-alive" https://localhost/test.txt

# æ£€æŸ¥ä¼šè¯å¤ç”¨ç»Ÿè®¡
echo ""
echo "3. SSLä¼šè¯å¤ç”¨ç»Ÿè®¡:"
# éœ€è¦åœ¨Nginxç¼–è¯‘æ—¶å¯ç”¨statusæ¨¡å—
curl -s http://localhost/nginx_status | grep ssl
```

### 9.5 ä¸åŒåŠ å¯†ç®—æ³•æ€§èƒ½å¯¹æ¯”


**ğŸ” åŠ å¯†ç®—æ³•é…ç½®æµ‹è¯•**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šssl-cipher-test.sh

echo "=== ä¸åŒSSLåŠ å¯†ç®—æ³•æ€§èƒ½å¯¹æ¯” ==="

# å®šä¹‰è¦æµ‹è¯•çš„åŠ å¯†å¥—ä»¶
CIPHERS=(
    "ECDHE-RSA-AES128-GCM-SHA256"
    "ECDHE-RSA-AES256-GCM-SHA384" 
    "ECDHE-RSA-CHACHA20-POLY1305"
    "RSA-AES128-GCM-SHA256"
)

for CIPHER in "${CIPHERS[@]}"; do
    echo "æµ‹è¯•åŠ å¯†å¥—ä»¶: $CIPHER"
    
    # ä½¿ç”¨openssl s_timeæµ‹è¯•
    RESULT=$(echo "GET /test.txt HTTP/1.0\r\n\r\n" | \
             openssl s_time -connect localhost:443 -cipher $CIPHER -time 10 2>&1)
    
    CONNECTIONS=$(echo "$RESULT" | grep "connections in" | awk '{print $1}')
    echo "10ç§’å†…å»ºç«‹è¿æ¥æ•°: $CONNECTIONS"
    
    # è®¡ç®—æ¯ç§’è¿æ¥æ•°
    if [ ! -z "$CONNECTIONS" ]; then
        CPS=$(echo "scale=2; $CONNECTIONS / 10" | bc)
        echo "æ¯ç§’è¿æ¥æ•°: $CPS"
    fi
    
    echo "---"
done
```

### 9.6 HTTPSä¼˜åŒ–é…ç½®æµ‹è¯•


**âš¡ ä¼˜åŒ–é…ç½®å¯¹æ¯”**
```bash
#!/bin/bash
# åˆ›å»ºæ–‡ä»¶ï¼šhttps-optimization-test.sh

echo "=== HTTPSä¼˜åŒ–é…ç½®æ•ˆæœæµ‹è¯• ==="

# æµ‹è¯•å‡½æ•°
test_https_config() {
    local config_name=$1
    local test_description=$2
    
    echo "æµ‹è¯•é…ç½®: $config_name"
    echo "æè¿°: $test_description"
    
    # é‡è½½Nginxé…ç½®
    sudo nginx -s reload
    sleep 3
    
    # æ‰§è¡Œæ€§èƒ½æµ‹è¯•
    RESULT=$(wrk -t4 -c50 -d20s https://localhost/test.txt 2>/dev/null)
    QPS=$(echo "$RESULT" | grep "Requests/sec" | awk '{print $2}')
    LATENCY=$(echo "$RESULT" | grep "Latency" | head -1 | awk '{print $2}')
    
    echo "QPS: $QPS"
    echo "å¹³å‡å»¶è¿Ÿ: $LATENCY"
    echo "---"
}

# åŸºç¡€é…ç½®
cat > /tmp/ssl-basic.conf << 'EOF'
ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
ssl_session_cache off;
ssl_session_tickets off;
EOF

# ä¼˜åŒ–é…ç½®
cat > /tmp/ssl-optimized.conf << 'EOF'
ssl_protocols TLSv1.3;
ssl_ciphers TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 1d;
ssl_session_tickets on;
ssl_stapling on;
ssl_stapling_verify on;
EOF

# åº”ç”¨åŸºç¡€é…ç½®å¹¶æµ‹è¯•
sudo cp /tmp/ssl-basic.conf /etc/nginx/conf.d/ssl-config.conf
test_https_config "åŸºç¡€é…ç½®" "TLS1.2+1.3, æ— ä¼šè¯ç¼“å­˜"

# åº”ç”¨ä¼˜åŒ–é…ç½®å¹¶æµ‹è¯•  
sudo cp /tmp/ssl-optimized.conf /etc/nginx/conf.d/ssl-config.conf
test_https_config "ä¼˜åŒ–é…ç½®" "ä»…TLS1.3, å¯ç”¨ä¼šè¯ç¼“å­˜å’ŒOCSP"

echo "ä¼˜åŒ–é…ç½®æµ‹è¯•å®Œæˆ"
```

### 9.7 HTTPSæ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ”§ æœåŠ¡å™¨ç«¯ä¼˜åŒ–ç­–ç•¥**
```
SSL/TLSä¼˜åŒ–è¦ç‚¹ï¼š

åè®®é€‰æ‹©ï¼š
â”œâ”€â”€ ä¼˜å…ˆä½¿ç”¨TLS 1.3ï¼šæ¡æ‰‹æ›´å¿«ï¼ŒåŠ å¯†æ›´å¼º
â”œâ”€â”€ ç¦ç”¨è€æ—§åè®®ï¼šTLS 1.0, TLS 1.1å·²ä¸å®‰å…¨
â””â”€â”€ åˆç†é…ç½®åŠ å¯†å¥—ä»¶ï¼šå¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½

ä¼šè¯ç®¡ç†ï¼š
â”œâ”€â”€ å¯ç”¨SSLä¼šè¯ç¼“å­˜ï¼šå‡å°‘é‡å¤æ¡æ‰‹å¼€é”€
â”œâ”€â”€ åˆç†è®¾ç½®ç¼“å­˜å¤§å°ï¼šæ ¹æ®å¹¶å‘é‡è°ƒæ•´
â”œâ”€â”€ å¯ç”¨ä¼šè¯ç¥¨æ®ï¼šæ”¯æŒæ— çŠ¶æ€ä¼šè¯å¤ç”¨
â””â”€â”€ è®¾ç½®åˆç†è¶…æ—¶ï¼šå¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½

ç¡¬ä»¶åŠ é€Ÿï¼š
â”œâ”€â”€ ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿå¡ï¼šAES-NIæŒ‡ä»¤é›†
â”œâ”€â”€ å¯ç”¨SSL offloadï¼šä¸“ç”¨SSLåŠ é€Ÿè®¾å¤‡
â””â”€â”€ åˆç†é…ç½®workerï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸CPU

è¯ä¹¦ä¼˜åŒ–ï¼š
â”œâ”€â”€ ä½¿ç”¨ECCè¯ä¹¦ï¼šç›¸åŒå®‰å…¨çº§åˆ«ä¸‹æ›´å°æ›´å¿«
â”œâ”€â”€ å¯ç”¨OCSP Staplingï¼šå‡å°‘è¯ä¹¦éªŒè¯å»¶è¿Ÿ  
â”œâ”€â”€ é…ç½®HSTSï¼šå‡å°‘HTTPé‡å®šå‘
â””â”€â”€ ä½¿ç”¨HTTP/2ï¼šå¤ç”¨è¿æ¥ï¼Œæå‡æ•ˆç‡
```

**ğŸ“Š HTTPSæ€§èƒ½åŸºå‡†**

| ä¼˜åŒ–çº§åˆ« | **ç›¸å¯¹HTTPæ€§èƒ½** | **SSLæ¡æ‰‹æ—¶é—´** | **ä¼šè¯å¤ç”¨ç‡** |
|---------|-----------------|----------------|---------------|
| **æœªä¼˜åŒ–** | 60-70% | 50-200ms | < 20% |
| **åŸºç¡€ä¼˜åŒ–** | 70-85% | 20-80ms | 40-60% |
| **æ·±åº¦ä¼˜åŒ–** | 85-95% | 10-40ms | 70-90% |
| **ç¡¬ä»¶åŠ é€Ÿ** | 90-98% | 5-20ms | 80-95% |

> ğŸ’¡ **å…³é”®æç¤º**ï¼šç°ä»£HTTPSåœ¨åˆç†ä¼˜åŒ–åï¼Œæ€§èƒ½æŸå¤±å¯ä»¥æ§åˆ¶åœ¨5-15%ä»¥å†…ï¼Œå®‰å…¨æ”¶ç›Šè¿œå¤§äºæ€§èƒ½æˆæœ¬ã€‚

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ æ€§èƒ½æµ‹è¯•åŸºç¡€è®¤çŸ¥**
```
Webæ€§èƒ½æµ‹è¯•æœ¬è´¨ï¼š
â”œâ”€â”€ ç›®æ ‡ï¼šéªŒè¯ç³»ç»Ÿåœ¨ä¸åŒè´Ÿè½½ä¸‹çš„è¡¨ç°èƒ½åŠ›
â”œâ”€â”€ æŒ‡æ ‡ï¼šQPSã€å“åº”æ—¶é—´ã€å¹¶å‘æ•°ã€é”™è¯¯ç‡
â”œâ”€â”€ ç±»å‹ï¼šåŸºå‡†æµ‹è¯•ã€è´Ÿè½½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€å®¹é‡æµ‹è¯•
â””â”€â”€ ä»·å€¼ï¼šå‘ç°ç“¶é¢ˆã€éªŒè¯å®¹é‡ã€æŒ‡å¯¼ä¼˜åŒ–
```

**ğŸ”§ æ ¸å¿ƒå·¥å…·ç‰¹ç‚¹**
```
å·¥å…·é€‰æ‹©æŒ‡å—ï¼š

Apache Bench (ab)ï¼š
â”œâ”€â”€ ä¼˜åŠ¿ï¼šç®€å•æ˜“ç”¨ã€å¹¿æ³›æ”¯æŒã€æ ‡å‡†åŒ–
â”œâ”€â”€ é™åˆ¶ï¼šå•çº¿ç¨‹ã€åŠŸèƒ½åŸºç¡€
â””â”€â”€ é€‚ç”¨ï¼šå¿«é€ŸåŸºå‡†æµ‹è¯•ã€ç®€å•åœºæ™¯

wrkï¼š
â”œâ”€â”€ ä¼˜åŠ¿ï¼šé«˜æ€§èƒ½ã€å¯ç¼–ç¨‹ã€ç°ä»£åŒ–
â”œâ”€â”€ ç‰¹ç‚¹ï¼šå¤šçº¿ç¨‹ã€Luaè„šæœ¬ã€ç²¾ç¡®ç»Ÿè®¡
â””â”€â”€ é€‚ç”¨ï¼šé«˜è´Ÿè½½æµ‹è¯•ã€å¤æ‚åœºæ™¯

siegeï¼š
â”œâ”€â”€ ä¼˜åŠ¿ï¼šçœŸå®ç”¨æˆ·æ¨¡æ‹Ÿã€å¤šURLæµ‹è¯•
â”œâ”€â”€ ç‰¹ç‚¹ï¼šæ”¯æŒå»¶è¿Ÿã€é…ç½®çµæ´»
â””â”€â”€ é€‚ç”¨ï¼šç”¨æˆ·è¡Œä¸ºæ¨¡æ‹Ÿã€ç»¼åˆæµ‹è¯•
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é™æ€vsåŠ¨æ€å†…å®¹æ€§èƒ½å·®å¼‚**
```
æ€§èƒ½ç‰¹å¾å¯¹æ¯”ï¼š

é™æ€æ–‡ä»¶æœåŠ¡ï¼š
â”œâ”€â”€ é«˜QPSï¼š10,000-50,000+
â”œâ”€â”€ ä½å»¶è¿Ÿï¼š< 10ms
â”œâ”€â”€ ç“¶é¢ˆï¼šç½‘ç»œå¸¦å®½ã€ç£ç›˜IO
â””â”€â”€ ä¼˜åŒ–ï¼šç¼“å­˜ã€å‹ç¼©ã€CDN

åŠ¨æ€å†…å®¹ç”Ÿæˆï¼š
â”œâ”€â”€ ä¸­ç­‰QPSï¼š100-2,000
â”œâ”€â”€ ä¸­ç­‰å»¶è¿Ÿï¼š50-500ms  
â”œâ”€â”€ ç“¶é¢ˆï¼šCPUè®¡ç®—ã€æ•°æ®åº“æŸ¥è¯¢
â””â”€â”€ ä¼˜åŒ–ï¼šç¼“å­˜ã€æ•°æ®åº“ä¼˜åŒ–ã€ç®—æ³•ä¼˜åŒ–
```

**ğŸ”¹ å¹¶å‘æµ‹è¯•çš„æ ¸å¿ƒä»·å€¼**
```
å¹¶å‘æµ‹è¯•æ„ä¹‰ï¼š
â”œâ”€â”€ æ‰¾åˆ°æ€§èƒ½æ‹ç‚¹ï¼šç¡®å®šç³»ç»Ÿæ‰¿è½½æé™
â”œâ”€â”€ éªŒè¯æ‰©å±•æ€§ï¼šäº†è§£ç³»ç»Ÿæ‰©å±•ç‰¹æ€§
â”œâ”€â”€ å‘ç°èµ„æºç“¶é¢ˆï¼šCPUã€å†…å­˜ã€ç½‘ç»œé™åˆ¶
â””â”€â”€ æŒ‡å¯¼å®¹é‡è§„åˆ’ï¼šä¸ºç”Ÿäº§ç¯å¢ƒæä¾›ä¾æ®
```

**ğŸ”¹ é•¿è¿æ¥çš„æ€§èƒ½å½±å“**
```
è¿æ¥å¤ç”¨æ”¶ç›Šï¼š
â”œâ”€â”€ QPSæå‡ï¼š20-300%ï¼ˆå–å†³äºåœºæ™¯ï¼‰
â”œâ”€â”€ å»¶è¿Ÿé™ä½ï¼šå‡å°‘TCPæ¡æ‰‹å¼€é”€
â”œâ”€â”€ èµ„æºèŠ‚çº¦ï¼šå‡å°‘è¿æ¥å»ºç«‹/é‡Šæ”¾æ¶ˆè€—
â””â”€â”€ ç”¨æˆ·ä½“éªŒï¼šæ›´å¿«çš„é¡µé¢åŠ è½½é€Ÿåº¦
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… æµ‹è¯•æ‰§è¡Œæœ€ä½³å®è·µ**
```
æµ‹è¯•å‡†å¤‡ï¼š
â”œâ”€â”€ ç¯å¢ƒéš”ç¦»ï¼šç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ æ•°æ®å‡†å¤‡ï¼šè¶³å¤Ÿçš„æµ‹è¯•æ•°æ®
â”œâ”€â”€ ç›‘æ§é…ç½®ï¼šå…¨é¢çš„æ€§èƒ½ç›‘æ§
â””â”€â”€ åŸºçº¿å»ºç«‹ï¼šæ­£å¸¸çŠ¶æ€ä¸‹çš„æ€§èƒ½åŸºå‡†

æµ‹è¯•æ‰§è¡Œï¼š
â”œâ”€â”€ æ¸è¿›åŠ å‹ï¼šä»å°è´Ÿè½½å¼€å§‹é€æ­¥å¢åŠ 
â”œâ”€â”€ å……åˆ†é¢„çƒ­ï¼šè®©ç³»ç»Ÿè¾¾åˆ°ç¨³å®šçŠ¶æ€
â”œâ”€â”€ å¤šè½®éªŒè¯ï¼šç¡®ä¿ç»“æœçš„å¯é‡å¤æ€§
â””â”€â”€ å¼‚å¸¸ç›‘æ§ï¼šå…³æ³¨é”™è¯¯ç‡å’Œå¼‚å¸¸æƒ…å†µ

ç»“æœåˆ†æï¼š
â”œâ”€â”€ å¤šç»´åº¦è¯„ä¼°ï¼šä¸åªçœ‹QPSï¼Œè¿˜è¦çœ‹å»¶è¿Ÿå’Œç¨³å®šæ€§
â”œâ”€â”€ ç“¶é¢ˆå®šä½ï¼šè¯†åˆ«é™åˆ¶æ€§èƒ½çš„å…³é”®å› ç´ 
â”œâ”€â”€ è¶‹åŠ¿åˆ†æï¼šäº†è§£æ€§èƒ½éšè´Ÿè½½å˜åŒ–çš„è¶‹åŠ¿
â””â”€â”€ ä¼˜åŒ–å»ºè®®ï¼šåŸºäºæµ‹è¯•ç»“æœæå‡ºæ”¹è¿›æ–¹æ¡ˆ
```

**ğŸ¯ å…³é”®æ€§èƒ½æŒ‡æ ‡æ ‡å‡†**

| åº”ç”¨ç±»å‹ | **QPSæœŸæœ›** | **å“åº”æ—¶é—´** | **å¯ç”¨æ€§** | **å¹¶å‘æ•°** |
|---------|------------|-------------|-----------|-----------|
| **é™æ€ç½‘ç«™** | > 5,000 | < 50ms | > 99.9% | > 1,000 |
| **åŠ¨æ€ç½‘ç«™** | > 500 | < 200ms | > 99.5% | > 200 |
| **APIæœåŠ¡** | > 1,000 | < 100ms | > 99.8% | > 500 |
| **å®æ—¶ç³»ç»Ÿ** | > 10,000 | < 10ms | > 99.99% | > 5,000 |

### 10.4 ä¼˜åŒ–ç­–ç•¥æ€»ç»“


**âš¡ é€šç”¨ä¼˜åŒ–åŸåˆ™**
```
æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š

æœåŠ¡å™¨ä¼˜åŒ–ï¼š
â”œâ”€â”€ é™æ€èµ„æºï¼šå¯ç”¨å‹ç¼©ã€è®¾ç½®ç¼“å­˜ã€ä½¿ç”¨CDN
â”œâ”€â”€ åŠ¨æ€å†…å®¹ï¼šæ•°æ®åº“ä¼˜åŒ–ã€åº”ç”¨ç¼“å­˜ã€ä»£ç ä¼˜åŒ–
â”œâ”€â”€ è¿æ¥ç®¡ç†ï¼šå¯ç”¨Keep-Aliveã€é…ç½®è¿æ¥æ± 
â””â”€â”€ ç³»ç»Ÿè°ƒä¼˜ï¼šå†…æ ¸å‚æ•°ã€æ–‡ä»¶æè¿°ç¬¦é™åˆ¶

åº”ç”¨ä¼˜åŒ–ï¼š
â”œâ”€â”€ ç¼“å­˜ç­–ç•¥ï¼šå¤šå±‚ç¼“å­˜ã€ç¼“å­˜é¢„çƒ­ã€ç¼“å­˜æ›´æ–°
â”œâ”€â”€ æ•°æ®åº“ï¼šç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–ã€è¿æ¥æ± 
â”œâ”€â”€ ä»£ç ä¼˜åŒ–ï¼šç®—æ³•ä¼˜åŒ–ã€å†…å­˜ç®¡ç†ã€å¼‚æ­¥å¤„ç†
â””â”€â”€ æ¶æ„ä¼˜åŒ–ï¼šè´Ÿè½½å‡è¡¡ã€å¾®æœåŠ¡ã€è¯»å†™åˆ†ç¦»

ç›‘æ§è¿ç»´ï¼š
â”œâ”€â”€ å®æ—¶ç›‘æ§ï¼šæ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯ç‡ã€èµ„æºä½¿ç”¨
â”œâ”€â”€ å‘Šè­¦æœºåˆ¶ï¼šé˜ˆå€¼å‘Šè­¦ã€è¶‹åŠ¿å‘Šè­¦ã€å¼‚å¸¸æ£€æµ‹
â”œâ”€â”€ å®¹é‡è§„åˆ’ï¼šåŸºäºç›‘æ§æ•°æ®è¿›è¡Œå®¹é‡é¢„æµ‹
â””â”€â”€ æ•…éšœå¤„ç†ï¼šå¿«é€Ÿå®šä½ã€åº”æ€¥é¢„æ¡ˆã€æ¢å¤æµç¨‹
```

### 10.5 å­¦ä¹ è¦ç‚¹å¼ºåŒ–


**ğŸ§  æ ¸å¿ƒè®°å¿†è¦ç‚¹**
- **å·¥å…·é€‰æ‹©**ï¼šabç®€å•å¿«é€Ÿï¼ŒwrkåŠŸèƒ½å¼ºå¤§ï¼Œsiegeæ¨¡æ‹ŸçœŸå®
- **æµ‹è¯•ç­–ç•¥**ï¼šæ¸è¿›åŠ å‹ï¼Œå……åˆ†é¢„çƒ­ï¼Œå¤šç»´åˆ†æ
- **æ€§èƒ½æŒ‡æ ‡**ï¼šQPSçœ‹ååï¼Œå»¶è¿Ÿçœ‹ä½“éªŒï¼Œé”™è¯¯ç‡çœ‹ç¨³å®šæ€§
- **ä¼˜åŒ–æ–¹å‘**ï¼šé™æ€ç”¨ç¼“å­˜ï¼ŒåŠ¨æ€ä¼˜æ•°æ®åº“ï¼Œè¿æ¥è¦å¤ç”¨
- **HTTPSå½±å“**ï¼šç°ä»£ä¼˜åŒ–åæ€§èƒ½æŸå¤±å¯æ§åˆ¶åœ¨10%ä»¥å†…

**ğŸš€ è¿›é˜¶å­¦ä¹ æ–¹å‘**
- **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šCI/CDé›†æˆã€æ€§èƒ½å›å½’æµ‹è¯•
- **äº‘ç¯å¢ƒæµ‹è¯•**ï¼šåˆ†å¸ƒå¼æµ‹è¯•ã€å®¹å™¨åŒ–æµ‹è¯•ç¯å¢ƒ
- **APMå·¥å…·**ï¼šApplication Performance Monitoring
- **æ€§èƒ½è°ƒä¼˜**ï¼šJVMè°ƒä¼˜ã€æ•°æ®åº“è°ƒä¼˜ã€ç½‘ç»œè°ƒä¼˜

> ğŸ’ª **å®è·µå»ºè®®**ï¼šç†è®ºå­¦ä¹ åè¦å¤šåŠ¨æ‰‹å®è·µï¼Œåœ¨çœŸå®ç¯å¢ƒä¸­æµ‹è¯•å’Œä¼˜åŒ–ï¼Œç§¯ç´¯ç»éªŒï¼ŒåŸ¹å…»æ€§èƒ½è°ƒä¼˜çš„ç›´è§‰å’ŒæŠ€èƒ½ã€‚