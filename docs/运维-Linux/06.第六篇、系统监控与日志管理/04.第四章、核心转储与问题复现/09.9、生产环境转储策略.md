---
title: 9ã€ç”Ÿäº§ç¯å¢ƒè½¬å‚¨ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒè½¬å‚¨æ¦‚è¿°](#1-ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒè½¬å‚¨æ¦‚è¿°)
2. [Core Dumpå¯ç”¨ç­–ç•¥](#2-Core-Dumpå¯ç”¨ç­–ç•¥)
3. [æ€§èƒ½å½±å“ä¸èµ„æºæ¶ˆè€—](#3-æ€§èƒ½å½±å“ä¸èµ„æºæ¶ˆè€—)
4. [ç£ç›˜ç©ºé—´è§„åˆ’ç®¡ç†](#4-ç£ç›˜ç©ºé—´è§„åˆ’ç®¡ç†)
5. [å®‰å…¨ä¸æ•æ„Ÿæ•°æ®å¤„ç†](#5-å®‰å…¨ä¸æ•æ„Ÿæ•°æ®å¤„ç†)
6. [è‡ªåŠ¨åŒ–æ”¶é›†åˆ†ææµç¨‹](#6-è‡ªåŠ¨åŒ–æ”¶é›†åˆ†ææµç¨‹)
7. [å‘Šè­¦é€šçŸ¥æœºåˆ¶](#7-å‘Šè­¦é€šçŸ¥æœºåˆ¶)
8. [ä¼ è¾“å¤‡ä»½ç­–ç•¥](#8-ä¼ è¾“å¤‡ä»½ç­–ç•¥)
9. [åˆè§„ä¸æ•°æ®ä¿æŠ¤](#9-åˆè§„ä¸æ•°æ®ä¿æŠ¤)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¢ ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒè½¬å‚¨æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç”Ÿäº§ç¯å¢ƒCore Dump


**æ ¸å¿ƒå®šä¹‰**
```
Core Dumpï¼šç¨‹åºå´©æºƒæ—¶ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„å†…å­˜å¿«ç…§æ–‡ä»¶
ç”Ÿäº§ç¯å¢ƒï¼šå®é™…ä¸ºç”¨æˆ·æä¾›æœåŠ¡çš„è¿è¡Œç¯å¢ƒ
ç›®æ ‡ï¼šåœ¨ä¸å½±å“æœåŠ¡ç¨³å®šæ€§çš„å‰æä¸‹ï¼Œè·å–æ•…éšœè¯Šæ–­ä¿¡æ¯
```

**ä¸ºä»€ä¹ˆç”Ÿäº§ç¯å¢ƒéœ€è¦ç‰¹æ®Šè€ƒè™‘**
```
å¼€å‘/æµ‹è¯•ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒï¼š

å¼€å‘ç¯å¢ƒï¼š
âœ… å¯ä»¥éšæ„é‡å¯
âœ… æ€§èƒ½è¦æ±‚ä¸ä¸¥æ ¼
âœ… æ•°æ®ä¸æ•æ„Ÿ
âœ… å¯ä»¥é•¿æ—¶é—´è°ƒè¯•

ç”Ÿäº§ç¯å¢ƒï¼š
âš ï¸ æœåŠ¡ä¸­æ–­å½±å“ç”¨æˆ·
âš ï¸ æ€§èƒ½è¦æ±‚æé«˜
âš ï¸ åŒ…å«æ•æ„Ÿæ•°æ®
âš ï¸ å¿…é¡»å¿«é€Ÿæ¢å¤
```

### 1.2 ç”Ÿäº§ç¯å¢ƒæŒ‘æˆ˜åˆ†æ


**ä¸»è¦æŒ‘æˆ˜çŸ©é˜µ**

| æŒ‘æˆ˜ç±»å‹ | **å…·ä½“é—®é¢˜** | **å½±å“ç¨‹åº¦** | **è§£å†³å¤æ‚åº¦** |
|---------|-------------|-------------|---------------|
| ğŸ”¥ **æ€§èƒ½å½±å“** | `è½¬å‚¨ç”Ÿæˆæ¶ˆè€—CPU/IO` | `é«˜` | `ä¸­ç­‰` |
| ğŸ’¾ **å­˜å‚¨å‹åŠ›** | `å¤§é‡è½¬å‚¨æ–‡ä»¶å ç”¨ç£ç›˜` | `é«˜` | `ä½` |
| ğŸ” **å®‰å…¨é£é™©** | `å†…å­˜æ•°æ®æ³„éœ²æ•æ„Ÿä¿¡æ¯` | `æé«˜` | `é«˜` |
| â±ï¸ **æ—¶é—´çª—å£** | `æ•…éšœæ¢å¤æ—¶é—´è¦æ±‚` | `é«˜` | `ä¸­ç­‰` |
| ğŸ“Š **æ•°æ®ä¼ è¾“** | `å¤§æ–‡ä»¶ç½‘ç»œä¼ è¾“æˆæœ¬` | `ä¸­ç­‰` | `ä¸­ç­‰` |

---

## 2. âš™ï¸ Core Dumpå¯ç”¨ç­–ç•¥


### 2.1 æ¸è¿›å¼å¯ç”¨æ–¹æ¡ˆ


**ç­–ç•¥çº§åˆ«åˆ†ç±»**
```
Level 1: å…³é”®æœåŠ¡ä¼˜å…ˆ
â”œâ”€â”€ æ•°æ®åº“æœåŠ¡ (MySQL, PostgreSQL)
â”œâ”€â”€ Webåº”ç”¨æœåŠ¡å™¨ (Apache, Nginx)
â”œâ”€â”€ ç¼“å­˜æœåŠ¡ (Redis, Memcached)
â””â”€â”€ æ¶ˆæ¯é˜Ÿåˆ— (RabbitMQ, Kafka)

Level 2: ä¸šåŠ¡åº”ç”¨
â”œâ”€â”€ æ ¸å¿ƒä¸šåŠ¡è¿›ç¨‹
â”œâ”€â”€ æ”¯ä»˜ç›¸å…³æœåŠ¡
â”œâ”€â”€ ç”¨æˆ·è®¤è¯æœåŠ¡
â””â”€â”€ APIç½‘å…³æœåŠ¡

Level 3: è¾…åŠ©å·¥å…·
â”œâ”€â”€ ç›‘æ§å·¥å…·
â”œâ”€â”€ æ—¥å¿—æ”¶é›†å™¨
â”œâ”€â”€ å®šæ—¶ä»»åŠ¡
â””â”€â”€ ç®¡ç†è„šæœ¬
```

### 2.2 åˆ†é˜¶æ®µéƒ¨ç½²ç­–ç•¥


**é˜¶æ®µä¸€ï¼šæµ‹è¯•éªŒè¯**
```bash
# åœ¨é¢„ç”Ÿäº§ç¯å¢ƒéªŒè¯é…ç½®
echo 'kernel.core_pattern = /var/core/core.%e.%p.%t' >> /etc/sysctl.conf
echo '* soft core unlimited' >> /etc/security/limits.conf

# éªŒè¯æµ‹è¯•
ulimit -c unlimited
./test_crash_program
ls -la /var/core/
```

**é˜¶æ®µäºŒï¼šå•æœåŠ¡è¯•ç‚¹**
```bash
# ä¸ºç‰¹å®šæœåŠ¡å¯ç”¨core dump
systemctl edit myapp.service

# æ·»åŠ é…ç½®
[Service]
LimitCORE=infinity
Environment="GOTRACEBACK=crash"
```

**é˜¶æ®µä¸‰ï¼šé€æ­¥æ¨å¹¿**
```bash
# æ‰¹é‡éƒ¨ç½²è„šæœ¬
#!/bin/bash
SERVICES=("nginx" "mysql" "redis")

for service in "${SERVICES[@]}"; do
    echo "é…ç½® $service çš„ core dump..."
    systemctl edit $service --force <<EOF
[Service]
LimitCORE=infinity
EOF
    systemctl daemon-reload
    echo "$service é…ç½®å®Œæˆ"
done
```

### 2.3 æ™ºèƒ½å¯ç”¨æ¡ä»¶


**æ¡ä»¶è§¦å‘æœºåˆ¶**
```bash
#!/bin/bash
# æ™ºèƒ½å¯ç”¨è„šæœ¬

check_system_load() {
    load=$(uptime | awk '{print $10}' | sed 's/,//')
    if (( $(echo "$load > 2.0" | bc -l) )); then
        return 1  # è´Ÿè½½è¿‡é«˜ï¼Œä¸å¯ç”¨
    fi
    return 0
}

check_disk_space() {
    usage=$(df /var/core | tail -1 | awk '{print $5}' | sed 's/%//')
    if [ $usage -gt 80 ]; then
        return 1  # ç£ç›˜ç©ºé—´ä¸è¶³
    fi
    return 0
}

enable_core_dump() {
    if check_system_load && check_disk_space; then
        echo "ç³»ç»ŸçŠ¶æ€è‰¯å¥½ï¼Œå¯ç”¨core dump"
        ulimit -c unlimited
        return 0
    else
        echo "ç³»ç»ŸçŠ¶æ€ä¸ä½³ï¼Œè·³è¿‡å¯ç”¨"
        return 1
    fi
}
```

---

## 3. ğŸ“Š æ€§èƒ½å½±å“ä¸èµ„æºæ¶ˆè€—


### 3.1 æ€§èƒ½å½±å“è¯„ä¼°


**CPUå¼€é”€åˆ†æ**
```
Core Dumpç”Ÿæˆè¿‡ç¨‹çš„CPUæ¶ˆè€—ï¼š

å†…å­˜éå†é˜¶æ®µï¼š
â”œâ”€â”€ è¿›ç¨‹å†…å­˜ç©ºé—´æ‰«æ      CPUä½¿ç”¨ç‡: 15-25%
â”œâ”€â”€ å†…å­˜é¡µé¢è¯»å–          CPUä½¿ç”¨ç‡: 10-20%
â””â”€â”€ æ•°æ®å‹ç¼©å¤„ç†          CPUä½¿ç”¨ç‡: 20-30%

æ€»ä½“å½±å“ï¼š
â”œâ”€â”€ å°è¿›ç¨‹ (<100MB)ï¼š     å½±å“æ—¶é—´: 1-3ç§’
â”œâ”€â”€ ä¸­ç­‰è¿›ç¨‹ (100MB-1GB)ï¼š å½±å“æ—¶é—´: 5-15ç§’
â””â”€â”€ å¤§è¿›ç¨‹ (>1GB)ï¼š       å½±å“æ—¶é—´: 30ç§’-2åˆ†é’Ÿ
```

**å†…å­˜å¼€é”€æ¨¡å¼**
```
ä¸´æ—¶å†…å­˜éœ€æ±‚ï¼š

åŸºç¡€å¼€é”€ï¼š
åŸè¿›ç¨‹å†…å­˜ Ã— 0.1 = ä¸´æ—¶ç¼“å†²åŒºå¤§å°

ç¤ºä¾‹è®¡ç®—ï¼š
â”œâ”€â”€ 500MBè¿›ç¨‹ â†’ 50MBä¸´æ—¶å†…å­˜
â”œâ”€â”€ 2GBè¿›ç¨‹   â†’ 200MBä¸´æ—¶å†…å­˜
â””â”€â”€ 8GBè¿›ç¨‹   â†’ 800MBä¸´æ—¶å†…å­˜

å³°å€¼å†…å­˜è®¡ç®—ï¼š
æ€»éœ€æ±‚ = åŸè¿›ç¨‹å†…å­˜ + ä¸´æ—¶ç¼“å†²åŒº + ç³»ç»Ÿé¢„ç•™(512MB)
```

### 3.2 IOæ€§èƒ½å½±å“


**ç£ç›˜å†™å…¥å‹åŠ›**
```bash
# ç›‘æ§core dumpç”Ÿæˆæ—¶çš„IO
iostat -x 1

# å…¸å‹IOæ¨¡å¼
è®¾å¤‡            %util    await    wMB/s
/dev/sda1       85.2     45.3     125.6   â† core dumpå†™å…¥æœŸé—´
/dev/sda1       12.1     8.2      15.3    â† æ­£å¸¸è¿è¡ŒæœŸé—´
```

**ç½‘ç»œå½±å“åˆ†æ**
```
ç½‘ç»œèµ„æºå ç”¨åœºæ™¯ï¼š

æœ¬åœ°ç”Ÿæˆï¼š
â””â”€â”€ æ— ç›´æ¥ç½‘ç»œå½±å“

è¿œç¨‹ä¼ è¾“ï¼š
â”œâ”€â”€ æ–‡ä»¶å¤§å°: é€šå¸¸ä¸ºè¿›ç¨‹å†…å­˜çš„ 60-80%
â”œâ”€â”€ ä¼ è¾“æ—¶é—´: å–å†³äºç½‘ç»œå¸¦å®½
â””â”€â”€ å¹¶å‘å½±å“: å¯èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡æµé‡
```

### 3.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**CPUä¼˜åŒ–é…ç½®**
```bash
# è®¾ç½®core dumpç”Ÿæˆçš„è¿›ç¨‹ä¼˜å…ˆçº§
echo 'kernel.core_pipe_limit = 2' >> /etc/sysctl.conf

# é™åˆ¶å¹¶å‘ç”Ÿæˆæ•°é‡
echo 'fs.suid_dumpable = 2' >> /etc/sysctl.conf

# ä½¿ç”¨ioniceé™ä½IOä¼˜å…ˆçº§
echo '|/usr/bin/ionice -c 3 /usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e' > /proc/sys/kernel/core_pattern
```

**å†…å­˜ä¼˜åŒ–æŠ€å·§**
```bash
# é…ç½®å†…å­˜æ˜ å°„ä¼˜åŒ–
echo 'vm.max_map_count = 262144' >> /etc/sysctl.conf

# è®¾ç½®OOM killerè¡Œä¸º
echo 'vm.oom_kill_allocating_task = 1' >> /etc/sysctl.conf
```

---

## 4. ğŸ’¾ ç£ç›˜ç©ºé—´è§„åˆ’ç®¡ç†


### 4.1 å­˜å‚¨å®¹é‡è§„åˆ’


**å®¹é‡é¢„ä¼°å…¬å¼**
```
åŸºç¡€è®¡ç®—æ¨¡å‹ï¼š

å•ä¸ªCore Dumpå¤§å° â‰ˆ è¿›ç¨‹å†…å­˜ä½¿ç”¨é‡ Ã— 0.7

æœˆåº¦å­˜å‚¨éœ€æ±‚è®¡ç®—ï¼š
æ¯æ—¥å´©æºƒæ¬¡æ•° Ã— å¹³å‡core dumpå¤§å° Ã— 30å¤© Ã— å®‰å…¨ç³»æ•°(1.5)

ç¤ºä¾‹è®¡ç®—ï¼š
è¿›ç¨‹å†…å­˜: 2GB
é¢„æœŸå´©æºƒ: 5æ¬¡/å¤©
æœˆåº¦éœ€æ±‚: 5 Ã— (2GB Ã— 0.7) Ã— 30 Ã— 1.5 = 315GB
```

**åˆ†å±‚å­˜å‚¨ç­–ç•¥**
```
å­˜å‚¨å±‚çº§è®¾è®¡ï¼š

é«˜é€Ÿå­˜å‚¨ (SSD)ï¼š
â”œâ”€â”€ å½“å‰7å¤©çš„core dump
â”œâ”€â”€ æ­£åœ¨åˆ†æçš„æ–‡ä»¶
â””â”€â”€ çƒ­ç‚¹æ•…éšœç›¸å…³æ–‡ä»¶

æ ‡å‡†å­˜å‚¨ (SATA)ï¼š
â”œâ”€â”€ 7-30å¤©çš„å†å²æ–‡ä»¶
â”œâ”€â”€ å·²åˆ†æå®Œæˆçš„æ–‡ä»¶
â””â”€â”€ å¤‡ä»½å½’æ¡£æ–‡ä»¶

å†·å­˜å‚¨ (å½’æ¡£)ï¼š
â”œâ”€â”€ 30å¤©ä»¥ä¸Šçš„æ–‡ä»¶
â”œâ”€â”€ æ³•è§„è¦æ±‚ä¿ç•™çš„æ–‡ä»¶
â””â”€â”€ å‹ç¼©åçš„é•¿æœŸå­˜å‚¨
```

### 4.2 è‡ªåŠ¨æ¸…ç†æœºåˆ¶


**åŸºäºæ—¶é—´çš„æ¸…ç†**
```bash
#!/bin/bash
# è‡ªåŠ¨æ¸…ç†è„šæœ¬ - æŒ‰æ—¶é—´

CORE_DIR="/var/core"
LOG_FILE="/var/log/core-cleanup.log"

cleanup_by_age() {
    echo "$(date): å¼€å§‹æŒ‰æ—¶é—´æ¸…ç†core dumpæ–‡ä»¶" >> $LOG_FILE
    
    # åˆ é™¤7å¤©å‰çš„æ–‡ä»¶
    find $CORE_DIR -name "core.*" -mtime +7 -exec rm -f {} \;
    
    # è®°å½•æ¸…ç†ç»“æœ
    count=$(find $CORE_DIR -name "core.*" | wc -l)
    echo "$(date): æ¸…ç†å®Œæˆï¼Œå‰©ä½™æ–‡ä»¶æ•°: $count" >> $LOG_FILE
}

# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
# 0 2 * * * /path/to/cleanup_cores.sh
```

**åŸºäºç©ºé—´çš„æ¸…ç†**
```bash
#!/bin/bash
# åŸºäºç£ç›˜ä½¿ç”¨ç‡çš„æ™ºèƒ½æ¸…ç†

check_disk_usage() {
    usage=$(df /var/core | tail -1 | awk '{print $5}' | sed 's/%//')
    echo $usage
}

smart_cleanup() {
    current_usage=$(check_disk_usage)
    
    if [ $current_usage -gt 80 ]; then
        echo "ç£ç›˜ä½¿ç”¨ç‡ ${current_usage}%ï¼Œå¼€å§‹æ¸…ç†..."
        
        # å…ˆåˆ é™¤æœ€è€çš„æ–‡ä»¶
        find /var/core -name "core.*" -type f -printf '%T@ %p\n' | \
        sort -n | head -10 | cut -d' ' -f2- | xargs rm -f
        
        # æ£€æŸ¥æ¸…ç†æ•ˆæœ
        new_usage=$(check_disk_usage)
        echo "æ¸…ç†åç£ç›˜ä½¿ç”¨ç‡: ${new_usage}%"
    fi
}
```

### 4.3 å‹ç¼©å­˜å‚¨ä¼˜åŒ–


**å‹ç¼©ç­–ç•¥é…ç½®**
```bash
# é…ç½®è‡ªåŠ¨å‹ç¼©
cat > /etc/systemd/system/core-compress.service << 'EOF'
[Unit]
Description=Core Dump Compression Service
After=multi-user.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/compress-cores.sh

[Install]
WantedBy=multi-user.target
EOF

# å‹ç¼©è„šæœ¬
cat > /usr/local/bin/compress-cores.sh << 'EOF'
#!/bin/bash
find /var/core -name "core.*" -size +100M -mtime +1 ! -name "*.gz" \
    -exec gzip {} \;
EOF
```

**å‹ç¼©æ•ˆæœå¯¹æ¯”**
```
å‹ç¼©æ•ˆæœç»Ÿè®¡ï¼š

åŸå§‹å¤§å° â†’ å‹ç¼©åå¤§å° (å‹ç¼©ç‡)
â”œâ”€â”€ 100MB   â†’ 15MB      (85%)
â”œâ”€â”€ 500MB   â†’ 65MB      (87%)
â”œâ”€â”€ 2GB     â†’ 240MB     (88%)
â””â”€â”€ 8GB     â†’ 920MB     (88.5%)

å¹³å‡å‹ç¼©ç‡: 85-90%
å­˜å‚¨èŠ‚çœ: å¯èŠ‚çœ80%ä»¥ä¸Šç©ºé—´
```

---

## 5. ğŸ” å®‰å…¨ä¸æ•æ„Ÿæ•°æ®å¤„ç†


### 5.1 æ•æ„Ÿæ•°æ®è¯†åˆ«


**å†…å­˜ä¸­çš„æ•æ„Ÿä¿¡æ¯ç±»å‹**
```
å¸¸è§æ•æ„Ÿæ•°æ®æ¸…å•ï¼š

ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼š
â”œâ”€â”€ å¯†ç å’Œå¯†é’¥
â”œâ”€â”€ èº«ä»½è¯å·ã€ç¤¾ä¿å·
â”œâ”€â”€ é“¶è¡Œå¡å·
â””â”€â”€ ä¸ªäººåœ°å€ä¿¡æ¯

ä¸šåŠ¡æ•æ„Ÿæ•°æ®ï¼š
â”œâ”€â”€ æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
â”œâ”€â”€ APIå¯†é’¥å’ŒToken
â”œâ”€â”€ åŠ å¯†è¯ä¹¦ç§é’¥
â””â”€â”€ å•†ä¸šæœºå¯†æ•°æ®

ç³»ç»Ÿæ•æ„Ÿä¿¡æ¯ï¼š
â”œâ”€â”€ ç³»ç»Ÿé…ç½®å¯†ç 
â”œâ”€â”€ å†…éƒ¨ç½‘ç»œä¿¡æ¯
â”œâ”€â”€ å®‰å…¨ç­–ç•¥é…ç½®
â””â”€â”€ å†…éƒ¨ç”¨æˆ·ä¿¡æ¯
```

### 5.2 æ•°æ®è„±æ•ç­–ç•¥


**Core Dumpè¿‡æ»¤é…ç½®**
```bash
# é…ç½®æ•æ„Ÿæ•°æ®è¿‡æ»¤å™¨
cat > /etc/coredump.conf << 'EOF'
[Coredump]
Storage=external
Compress=yes
ProcessSizeMax=2G
ExternalSizeMax=2G
JournalSizeMax=767M
MaxUse=50%
KeepFree=15%
EOF

# è‡ªå®šä¹‰è¿‡æ»¤è„šæœ¬
cat > /usr/local/bin/secure-coredump.sh << 'EOF'
#!/bin/bash
# å®‰å…¨çš„core dumpå¤„ç†è„šæœ¬

CORE_FILE="$1"
FILTERED_FILE="${CORE_FILE}.filtered"

# ä½¿ç”¨hexdumpå’Œsedè¿‡æ»¤æ•æ„Ÿæ¨¡å¼
hexdump -C "$CORE_FILE" | \
sed 's/password[[:space:]]*=[[:space:]]*[^[:space:]]*/password=***FILTERED***/gi' | \
sed 's/[0-9]\{4\}-[0-9]\{4\}-[0-9]\{4\}-[0-9]\{4\}/****-****-****-****/g' \
> "$FILTERED_FILE"

# åˆ é™¤åŸå§‹æ–‡ä»¶
rm "$CORE_FILE"
mv "$FILTERED_FILE" "$CORE_FILE"
EOF
```

### 5.3 è®¿é—®æ§åˆ¶æœºåˆ¶


**æ–‡ä»¶æƒé™è®¾ç½®**
```bash
# è®¾ç½®ä¸¥æ ¼çš„æ–‡ä»¶æƒé™
chmod 700 /var/core
chown root:root /var/core

# è®¾ç½®core dumpæ–‡ä»¶æƒé™
echo 'fs.suid_dumpable = 2' >> /etc/sysctl.conf

# åˆ›å»ºä¸“ç”¨ç”¨æˆ·ç»„
groupadd coredump-access
usermod -a -G coredump-access analyst_user
```

**SELinuxå®‰å…¨ç­–ç•¥**
```bash
# é…ç½®SELinuxä¸Šä¸‹æ–‡
semanage fcontext -a -t admin_home_t "/var/core(/.*)?"
restorecon -R /var/core

# åˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥
cat > coredump_policy.te << 'EOF'
module coredump_policy 1.0;

require {
    type unconfined_t;
    type admin_home_t;
    class file { read write create };
}

allow unconfined_t admin_home_t:file { read write create };
EOF

# ç¼–è¯‘å¹¶åŠ è½½ç­–ç•¥
checkmodule -M -m -o coredump_policy.mod coredump_policy.te
semodule_package -o coredump_policy.pp -m coredump_policy.mod
semodule -i coredump_policy.pp
```

---

## 6. ğŸ¤– è‡ªåŠ¨åŒ–æ”¶é›†åˆ†ææµç¨‹


### 6.1 è‡ªåŠ¨åŒ–æ”¶é›†æ¶æ„


**æ”¶é›†æµç¨‹å›¾**
```
å´©æºƒäº‹ä»¶è§¦å‘
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å†…æ ¸æ•è·å´©æºƒ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”Ÿæˆcore dump  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  systemd-coredump â”‚ â† ç³»ç»Ÿé»˜è®¤å¤„ç†å™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å…ƒæ•°æ®æå–     â”‚
â”‚   æ–‡ä»¶å‹ç¼©       â”‚
â”‚   æƒé™è®¾ç½®       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‡ªå®šä¹‰å¤„ç†è„šæœ¬  â”‚ â† æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–è„šæœ¬
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å®‰å…¨æ£€æŸ¥       â”‚
â”‚   æ•°æ®è„±æ•       â”‚
â”‚   é€šçŸ¥å‘é€       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    åˆ†æå¼•æ“      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç¬¦å·è§£æ       â”‚
â”‚   å †æ ˆåˆ†æ       â”‚
â”‚   æŠ¥å‘Šç”Ÿæˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 è‡ªåŠ¨åˆ†æè„šæœ¬


**æ ¸å¿ƒåˆ†æå¼•æ“**
```bash
#!/bin/bash
# è‡ªåŠ¨åŒ–core dumpåˆ†æè„šæœ¬

CORE_FILE="$1"
EXECUTABLE="$2"
OUTPUT_DIR="/var/analysis"

analyze_core() {
    local core_file="$1"
    local executable="$2"
    local timestamp=$(date +%Y%m%d_%H%M%S)
    local report_file="$OUTPUT_DIR/analysis_${timestamp}.txt"
    
    echo "=== Core Dump è‡ªåŠ¨åˆ†ææŠ¥å‘Š ===" > "$report_file"
    echo "æ—¶é—´: $(date)" >> "$report_file"
    echo "æ–‡ä»¶: $core_file" >> "$report_file"
    echo "ç¨‹åº: $executable" >> "$report_file"
    echo "" >> "$report_file"
    
    # åŸºæœ¬ä¿¡æ¯æå–
    echo "=== åŸºæœ¬ä¿¡æ¯ ===" >> "$report_file"
    file "$core_file" >> "$report_file"
    echo "" >> "$report_file"
    
    # GDBè‡ªåŠ¨åˆ†æ
    echo "=== å †æ ˆè·Ÿè¸ª ===" >> "$report_file"
    gdb -batch -ex "bt" -ex "info registers" -ex "quit" \
        "$executable" "$core_file" >> "$report_file" 2>&1
    
    # å†…å­˜æ˜ å°„åˆ†æ
    echo "=== å†…å­˜æ˜ å°„ ===" >> "$report_file"
    gdb -batch -ex "info proc mappings" -ex "quit" \
        "$executable" "$core_file" >> "$report_file" 2>&1
    
    echo "åˆ†ææŠ¥å‘Šç”Ÿæˆå®Œæˆ: $report_file"
}

# ä¸»æ‰§è¡Œé€»è¾‘
if [ $# -eq 2 ]; then
    analyze_core "$1" "$2"
else
    echo "ç”¨æ³•: $0 <core_file> <executable>"
    exit 1
fi
```

### 6.3 æ™ºèƒ½åˆ†ç±»ç³»ç»Ÿ


**é”™è¯¯æ¨¡å¼è¯†åˆ«**
```bash
#!/bin/bash
# æ™ºèƒ½é”™è¯¯åˆ†ç±»è„šæœ¬

classify_crash() {
    local report_file="$1"
    local classification=""
    
    # æ£€æŸ¥å¸¸è§å´©æºƒæ¨¡å¼
    if grep -q "SIGSEGV" "$report_file"; then
        if grep -q "0x0" "$report_file"; then
            classification="NULL_POINTER_DEREFERENCE"
        elif grep -q "stack overflow" "$report_file"; then
            classification="STACK_OVERFLOW"
        else
            classification="SEGMENTATION_FAULT"
        fi
    elif grep -q "SIGABRT" "$report_file"; then
        classification="ABORT_SIGNAL"
    elif grep -q "SIGFPE" "$report_file"; then
        classification="FLOATING_POINT_EXCEPTION"
    else
        classification="UNKNOWN_CRASH"
    fi
    
    echo "$classification"
}

# ç”Ÿæˆåˆ†ç±»æ ‡ç­¾
add_classification() {
    local report_file="$1"
    local class=$(classify_crash "$report_file")
    
    echo "" >> "$report_file"
    echo "=== è‡ªåŠ¨åˆ†ç±» ===" >> "$report_file"
    echo "å´©æºƒç±»å‹: $class" >> "$report_file"
    
    # æ·»åŠ å»ºè®®
    case "$class" in
        "NULL_POINTER_DEREFERENCE")
            echo "å»ºè®®: æ£€æŸ¥ç©ºæŒ‡é’ˆä½¿ç”¨ï¼Œæ·»åŠ ç©ºå€¼åˆ¤æ–­" >> "$report_file"
            ;;
        "STACK_OVERFLOW")
            echo "å»ºè®®: æ£€æŸ¥é€’å½’è°ƒç”¨ï¼Œå¢åŠ æ ˆç©ºé—´é™åˆ¶" >> "$report_file"
            ;;
        "ABORT_SIGNAL")
            echo "å»ºè®®: æ£€æŸ¥assertè¯­å¥å’Œå¼‚å¸¸å¤„ç†" >> "$report_file"
            ;;
    esac
}
```

---

## 7. ğŸš¨ å‘Šè­¦é€šçŸ¥æœºåˆ¶


### 7.1 å¤šçº§å‘Šè­¦ç­–ç•¥


**å‘Šè­¦çº§åˆ«å®šä¹‰**
```
å‘Šè­¦çº§åˆ«ä½“ç³»ï¼š

ğŸ”´ ç´§æ€¥ (P0)ï¼š
â”œâ”€â”€ æ ¸å¿ƒæœåŠ¡å´©æºƒ
â”œâ”€â”€ æ•°æ®åº“æœåŠ¡å¼‚å¸¸
â”œâ”€â”€ æ”¯ä»˜ç³»ç»Ÿæ•…éšœ
â””â”€â”€ å®‰å…¨ç›¸å…³å´©æºƒ

ğŸŸ¡ é‡è¦ (P1)ï¼š
â”œâ”€â”€ WebæœåŠ¡å´©æºƒ
â”œâ”€â”€ APIæœåŠ¡å¼‚å¸¸
â”œâ”€â”€ ç¼“å­˜æœåŠ¡æ•…éšœ
â””â”€â”€ æ‰¹å¤„ç†ä»»åŠ¡å¤±è´¥

ğŸŸ¢ ä¸€èˆ¬ (P2)ï¼š
â”œâ”€â”€ ç›‘æ§å·¥å…·å´©æºƒ
â”œâ”€â”€ æ—¥å¿—æœåŠ¡å¼‚å¸¸
â”œâ”€â”€ å¤‡ä»½ä»»åŠ¡å¤±è´¥
â””â”€â”€ å¼€å‘å·¥å…·æ•…éšœ
```

### 7.2 é€šçŸ¥æ¸ é“é…ç½®


**å¤šæ¸ é“é€šçŸ¥å®ç°**
```bash
#!/bin/bash
# å¤šæ¸ é“é€šçŸ¥è„šæœ¬

send_notification() {
    local level="$1"
    local service="$2"
    local core_file="$3"
    local message="$4"
    
    case "$level" in
        "P0")
            # ç´§æ€¥ï¼šç”µè¯ + çŸ­ä¿¡ + é‚®ä»¶ + å³æ—¶æ¶ˆæ¯
            send_phone_alert "$service" "$message"
            send_sms_alert "$service" "$message"
            send_email_alert "$service" "$message" "$core_file"
            send_slack_alert "$service" "$message"
            ;;
        "P1")
            # é‡è¦ï¼šé‚®ä»¶ + å³æ—¶æ¶ˆæ¯
            send_email_alert "$service" "$message" "$core_file"
            send_slack_alert "$service" "$message"
            ;;
        "P2")
            # ä¸€èˆ¬ï¼šä»…é‚®ä»¶
            send_email_alert "$service" "$message" "$core_file"
            ;;
    esac
}

send_email_alert() {
    local service="$1"
    local message="$2"
    local core_file="$3"
    
    cat > /tmp/alert_email.txt << EOF
ä¸»é¢˜: [Core Dump Alert] $service æœåŠ¡å´©æºƒ

æœåŠ¡åç§°: $service
å‘ç”Ÿæ—¶é—´: $(date)
Coreæ–‡ä»¶: $core_file
è¯¦ç»†ä¿¡æ¯: $message

è¯·ç«‹å³å¤„ç†è¯¥æ•…éšœã€‚
EOF

    mail -s "[Core Dump Alert] $service æœåŠ¡å´©æºƒ" \
         admin@company.com < /tmp/alert_email.txt
}

send_slack_alert() {
    local service="$1"
    local message="$2"
    
    curl -X POST -H 'Content-type: application/json' \
        --data "{\"text\":\"ğŸš¨ Core Dump Alert: $service å´©æºƒ\\n$message\"}" \
        "$SLACK_WEBHOOK_URL"
}
```

### 7.3 å‘Šè­¦æŠ‘åˆ¶ä¸èšåˆ


**é˜²æ­¢å‘Šè­¦é£æš´**
```bash
#!/bin/bash
# å‘Šè­¦æŠ‘åˆ¶è„šæœ¬

ALERT_STATE_FILE="/var/lib/coredump/alert_state"

check_alert_frequency() {
    local service="$1"
    local current_time=$(date +%s)
    local threshold=300  # 5åˆ†é’Ÿå†…ä¸é‡å¤å‘Šè­¦
    
    if [ -f "$ALERT_STATE_FILE" ]; then
        last_alert=$(grep "^$service:" "$ALERT_STATE_FILE" | cut -d: -f2)
        if [ -n "$last_alert" ]; then
            time_diff=$((current_time - last_alert))
            if [ $time_diff -lt $threshold ]; then
                return 1  # æŠ‘åˆ¶å‘Šè­¦
            fi
        fi
    fi
    
    # æ›´æ–°å‘Šè­¦çŠ¶æ€
    grep -v "^$service:" "$ALERT_STATE_FILE" > /tmp/alert_state_new 2>/dev/null
    echo "$service:$current_time" >> /tmp/alert_state_new
    mv /tmp/alert_state_new "$ALERT_STATE_FILE"
    
    return 0  # å…è®¸å‘Šè­¦
}

# èšåˆåŒç±»å‘Šè­¦
aggregate_alerts() {
    local time_window=600  # 10åˆ†é’Ÿèšåˆçª—å£
    local current_time=$(date +%s)
    
    # ç»Ÿè®¡æœ€è¿‘æ—¶é—´çª—å£å†…çš„å‘Šè­¦
    awk -v current=$current_time -v window=$time_window '
    BEGIN { FS=":" }
    {
        if (current - $2 <= window) {
            count[$1]++
            latest[$1] = $2
        }
    }
    END {
        for (service in count) {
            if (count[service] > 3) {
                print service " åœ¨è¿‡å»10åˆ†é’Ÿå†…å´©æºƒ " count[service] " æ¬¡"
            }
        }
    }' "$ALERT_STATE_FILE"
}
```

---

## 8. ğŸ“¦ ä¼ è¾“å¤‡ä»½ç­–ç•¥


### 8.1 åˆ†å¸ƒå¼å­˜å‚¨æ¶æ„


**å­˜å‚¨æ¶æ„è®¾è®¡**
```
åˆ†å¸ƒå¼å­˜å‚¨æ‹“æ‰‘ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”Ÿäº§æœåŠ¡å™¨A    â”‚    â”‚   ç”Ÿäº§æœåŠ¡å™¨B    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Core Files  â”‚ â”‚    â”‚  â”‚ Core Files  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  ä¸­å¤®æ”¶é›†æœåŠ¡å™¨   â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
          â”‚  â”‚  èšåˆå­˜å‚¨    â”‚ â”‚
          â”‚  â”‚  åˆ†æå¤„ç†    â”‚ â”‚
          â”‚  â”‚  å¤‡ä»½ç®¡ç†    â”‚ â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   é•¿æœŸå½’æ¡£å­˜å‚¨   â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
          â”‚  â”‚  å†·å­˜å‚¨      â”‚ â”‚
          â”‚  â”‚  åˆè§„ä¿ç•™    â”‚ â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ä¼ è¾“ä¼˜åŒ–ç­–ç•¥


**å¢é‡ä¼ è¾“æœºåˆ¶**
```bash
#!/bin/bash
# å¢é‡ä¼ è¾“è„šæœ¬

REMOTE_SERVER="backup.company.com"
LOCAL_CORE_DIR="/var/core"
REMOTE_CORE_DIR="/backup/cores"

sync_cores() {
    # ä½¿ç”¨rsyncè¿›è¡Œå¢é‡åŒæ­¥
    rsync -avz --progress \
          --include="*.core" \
          --include="*.gz" \
          --exclude="*" \
          --delete-after \
          "$LOCAL_CORE_DIR/" \
          "$REMOTE_SERVER:$REMOTE_CORE_DIR/"
    
    if [ $? -eq 0 ]; then
        echo "$(date): Coreæ–‡ä»¶åŒæ­¥æˆåŠŸ" >> /var/log/core-sync.log
    else
        echo "$(date): Coreæ–‡ä»¶åŒæ­¥å¤±è´¥" >> /var/log/core-sync.log
        # å‘é€å‘Šè­¦
        send_sync_failure_alert
    fi
}

# å‹ç¼©ä¼ è¾“ä¼˜åŒ–
compress_before_transfer() {
    local file="$1"
    local compressed="${file}.transfer.gz"
    
    # ä½¿ç”¨é«˜å‹ç¼©æ¯”
    gzip -9 < "$file" > "$compressed"
    
    # ä¼ è¾“å‹ç¼©æ–‡ä»¶
    scp "$compressed" "$REMOTE_SERVER:$REMOTE_CORE_DIR/"
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm "$compressed"
}
```

### 8.3 ç½‘ç»œä¼ è¾“ä¼˜åŒ–


**å¸¦å®½æ§åˆ¶ä¸ä¼˜å…ˆçº§**
```bash
#!/bin/bash
# ç½‘ç»œä¼ è¾“ä¼˜åŒ–é…ç½®

# ä½¿ç”¨trickleé™åˆ¶å¸¦å®½
transfer_with_limit() {
    local file="$1"
    local bandwidth_limit="1024"  # 1MB/sé™åˆ¶
    
    trickle -u $bandwidth_limit scp "$file" \
        "$REMOTE_SERVER:$REMOTE_CORE_DIR/"
}

# è®¾ç½®ç½‘ç»œä¼˜å…ˆçº§
configure_network_priority() {
    # ä¸ºcore dumpä¼ è¾“è®¾ç½®ä½ä¼˜å…ˆçº§
    iptables -t mangle -A OUTPUT -p tcp --dport 22 \
        -m owner --uid-owner coredump \
        -j DSCP --set-dscp-class cs1
}

# åˆ†æ—¶ä¼ è¾“ç­–ç•¥
schedule_transfer() {
    local current_hour=$(date +%H)
    
    # ä¸šåŠ¡ä½å³°æœŸä¼ è¾“
    if [ $current_hour -ge 2 ] && [ $current_hour -le 6 ]; then
        echo "ä½å³°æœŸï¼Œæ­£å¸¸ä¼ è¾“"
        return 0
    else
        echo "ä¸šåŠ¡é«˜å³°æœŸï¼Œå»¶è¿Ÿä¼ è¾“"
        return 1
    fi
}
```

---

## 9. âš–ï¸ åˆè§„ä¸æ•°æ®ä¿æŠ¤


### 9.1 æ³•è§„è¦æ±‚åˆ†æ


**ä¸»è¦åˆè§„æ¡†æ¶**
```
GDPR (æ¬§ç›Ÿé€šç”¨æ•°æ®ä¿æŠ¤æ¡ä¾‹)ï¼š
â”œâ”€â”€ æ•°æ®æœ€å°åŒ–åŸåˆ™
â”œâ”€â”€ ç›®çš„é™åˆ¶åŸåˆ™  
â”œâ”€â”€ å­˜å‚¨æœŸé™é™åˆ¶
â”œâ”€â”€ æ•°æ®ä¸»ä½“æƒåˆ©ä¿æŠ¤
â””â”€â”€ æ•°æ®æ³„éœ²é€šçŸ¥ä¹‰åŠ¡

SOX (è¨ç­æ–¯-å¥¥å…‹æ–¯åˆ©æ³•æ¡ˆ)ï¼š
â”œâ”€â”€ å†…éƒ¨æ§åˆ¶è¦æ±‚
â”œâ”€â”€ å®¡è®¡è·Ÿè¸ªéœ€æ±‚
â”œâ”€â”€ æ•°æ®å®Œæ•´æ€§ä¿è¯
â””â”€â”€ è®¿é—®æ§åˆ¶è®°å½•

HIPAA (å¥åº·ä¿é™©å¯æºæ€§æ³•æ¡ˆ)ï¼š
â”œâ”€â”€ ä¸ªäººå¥åº·ä¿¡æ¯ä¿æŠ¤
â”œâ”€â”€ æœ€å°æƒé™è®¿é—®
â”œâ”€â”€ åŠ å¯†ä¼ è¾“è¦æ±‚
â””â”€â”€ å®¡è®¡æ—¥å¿—è¦æ±‚
```

### 9.2 æ•°æ®ä¿æŠ¤æªæ–½


**åŠ å¯†ä¿æŠ¤ç­–ç•¥**
```bash
#!/bin/bash
# Core dumpæ–‡ä»¶åŠ å¯†è„šæœ¬

encrypt_core_file() {
    local core_file="$1"
    local encrypted_file="${core_file}.enc"
    local key_file="/etc/coredump/encryption.key"
    
    # ä½¿ç”¨AES-256åŠ å¯†
    openssl enc -aes-256-cbc -salt \
        -in "$core_file" \
        -out "$encrypted_file" \
        -pass file:"$key_file"
    
    # éªŒè¯åŠ å¯†
    if [ $? -eq 0 ]; then
        echo "æ–‡ä»¶åŠ å¯†æˆåŠŸ: $encrypted_file"
        # åˆ é™¤åŸå§‹æ–‡ä»¶
        shred -vfz -n 3 "$core_file"
        return 0
    else
        echo "æ–‡ä»¶åŠ å¯†å¤±è´¥"
        return 1
    fi
}

# å¯†é’¥ç®¡ç†
rotate_encryption_key() {
    local old_key="/etc/coredump/encryption.key"
    local new_key="/etc/coredump/encryption.key.new"
    
    # ç”Ÿæˆæ–°å¯†é’¥
    openssl rand -base64 32 > "$new_key"
    
    # é‡æ–°åŠ å¯†ç°æœ‰æ–‡ä»¶
    for file in /var/core/*.enc; do
        if [ -f "$file" ]; then
            decrypt_and_reencrypt "$file" "$old_key" "$new_key"
        fi
    done
    
    # æ›¿æ¢å¯†é’¥
    mv "$new_key" "$old_key"
    chmod 600 "$old_key"
}
```

### 9.3 å®¡è®¡è·Ÿè¸ªæœºåˆ¶


**è®¿é—®æ—¥å¿—è®°å½•**
```bash
#!/bin/bash
# å®¡è®¡æ—¥å¿—è®°å½•è„šæœ¬

AUDIT_LOG="/var/log/coredump-audit.log"

log_access() {
    local action="$1"
    local file="$2"
    local user="$3"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    echo "$timestamp|$user|$action|$file|$REMOTE_ADDR" >> "$AUDIT_LOG"
}

# æ–‡ä»¶è®¿é—®åŒ…è£…å™¨
secure_core_access() {
    local action="$1"
    local file="$2"
    local user=$(whoami)
    
    # æ£€æŸ¥æƒé™
    if ! check_user_permission "$user" "$file"; then
        log_access "ACCESS_DENIED" "$file" "$user"
        echo "è®¿é—®è¢«æ‹’ç»"
        return 1
    fi
    
    # è®°å½•è®¿é—®
    log_access "$action" "$file" "$user"
    
    case "$action" in
        "VIEW")
            less "$file"
            ;;
        "ANALYZE")
            gdb -batch "$file"
            ;;
        "DOWNLOAD")
            cp "$file" "/tmp/download/"
            ;;
    esac
}

# ç”Ÿæˆå®¡è®¡æŠ¥å‘Š
generate_audit_report() {
    local start_date="$1"
    local end_date="$2"
    
    awk -F'|' -v start="$start_date" -v end="$end_date" '
    $1 >= start && $1 <= end {
        users[$2]++
        actions[$3]++
        total++
    }
    END {
        print "=== å®¡è®¡æŠ¥å‘Š ==="
        print "ç»Ÿè®¡æœŸé—´: " start " åˆ° " end
        print "æ€»è®¿é—®æ¬¡æ•°: " total
        print ""
        print "ç”¨æˆ·è®¿é—®ç»Ÿè®¡:"
        for (user in users) {
            print "  " user ": " users[user] " æ¬¡"
        }
        print ""
        print "æ“ä½œç±»å‹ç»Ÿè®¡:"
        for (action in actions) {
            print "  " action ": " actions[action] " æ¬¡"
        }
    }' "$AUDIT_LOG"
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ”¸ ç”Ÿäº§ç¯å¢ƒç‰¹æ®Šæ€§ï¼šæ€§èƒ½æ•æ„Ÿã€æ•°æ®æ•æ„Ÿã€æœåŠ¡è¿ç»­æ€§è¦æ±‚é«˜
ğŸ”¸ å¯ç”¨ç­–ç•¥ï¼šåˆ†é˜¶æ®µã€åˆ†æœåŠ¡ã€æ¡ä»¶è§¦å‘çš„æ¸è¿›å¼éƒ¨ç½²
ğŸ”¸ æ€§èƒ½å½±å“ï¼šCPUå¼€é”€15-30%ã€å†…å­˜å¼€é”€10%ã€IOå‹åŠ›æ˜¾è‘—
ğŸ”¸ å­˜å‚¨è§„åˆ’ï¼šå®¹é‡é¢„ä¼°ã€åˆ†å±‚å­˜å‚¨ã€è‡ªåŠ¨æ¸…ç†ã€å‹ç¼©ä¼˜åŒ–
ğŸ”¸ å®‰å…¨ä¿æŠ¤ï¼šæ•°æ®è„±æ•ã€è®¿é—®æ§åˆ¶ã€åŠ å¯†ä¼ è¾“ã€å®¡è®¡è·Ÿè¸ª
ğŸ”¸ è‡ªåŠ¨åŒ–æµç¨‹ï¼šæ”¶é›†ã€åˆ†æã€åˆ†ç±»ã€å‘Šè­¦ã€ä¼ è¾“çš„ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–
```

### 10.2 å…³é”®å®æ–½è¦ç‚¹


**ğŸ”¹ éƒ¨ç½²å‰è¯„ä¼°æ¸…å•**
```
â˜‘ï¸ ç³»ç»Ÿèµ„æºå……è¶³æ€§è¯„ä¼°
â˜‘ï¸ ç£ç›˜ç©ºé—´é¢„ç•™è®¡ç®—
â˜‘ï¸ ç½‘ç»œå¸¦å®½å½±å“åˆ†æ
â˜‘ï¸ å®‰å…¨ç­–ç•¥åˆ¶å®š
â˜‘ï¸ å‘Šè­¦æœºåˆ¶é…ç½®
â˜‘ï¸ å¤‡ä»½ä¼ è¾“ç­–ç•¥
â˜‘ï¸ åˆè§„è¦æ±‚ç¡®è®¤
```

**ğŸ”¹ è¿ç»´ç›‘æ§é‡ç‚¹**
```
å®æ—¶ç›‘æ§æŒ‡æ ‡ï¼š
â”œâ”€â”€ ç£ç›˜ä½¿ç”¨ç‡ (é˜ˆå€¼80%)
â”œâ”€â”€ Coreæ–‡ä»¶ç”Ÿæˆé¢‘ç‡ (å¼‚å¸¸>5æ¬¡/å°æ—¶)
â”œâ”€â”€ ä¼ è¾“æˆåŠŸç‡ (ç›®æ ‡>95%)
â””â”€â”€ åˆ†æå¤„ç†å»¶è¿Ÿ (ç›®æ ‡<30åˆ†é’Ÿ)

å®šæœŸæ£€æŸ¥é¡¹ç›®ï¼š
â”œâ”€â”€ æ¸…ç†ç­–ç•¥æ‰§è¡Œæƒ…å†µ
â”œâ”€â”€ åŠ å¯†å¯†é’¥è½®æ¢
â”œâ”€â”€ å®¡è®¡æ—¥å¿—åˆ†æ
â””â”€â”€ åˆè§„æ€§æ£€æŸ¥
```

### 10.3 æ•…éšœæ’é™¤æŒ‡å—


**å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ç±»å‹ | **ç—‡çŠ¶è¡¨ç°** | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|-------------|
| ğŸš« **æ–‡ä»¶ç”Ÿæˆå¤±è´¥** | `æ— coreæ–‡ä»¶äº§ç”Ÿ` | `ulimité™åˆ¶/æƒé™é—®é¢˜` | `æ£€æŸ¥limits.confå’Œç›®å½•æƒé™` |
| ğŸ’¾ **ç£ç›˜ç©ºé—´ä¸è¶³** | `å†™å…¥å¤±è´¥/æ¸…ç†å¼‚å¸¸` | `é¢„ä¼°ä¸å‡†ç¡®/æ¸…ç†è„šæœ¬å¤±æ•ˆ` | `æ‰©å®¹ç£ç›˜/ä¿®å¤æ¸…ç†é€»è¾‘` |
| ğŸ” **æƒé™è®¿é—®é—®é¢˜** | `æ— æ³•è¯»å–/åˆ†æå¤±è´¥` | `SELinux/æƒé™é…ç½®é”™è¯¯` | `æ£€æŸ¥æ–‡ä»¶æƒé™å’ŒSELinuxä¸Šä¸‹æ–‡` |
| ğŸ“¡ **ä¼ è¾“åŒæ­¥å¤±è´¥** | `å¤‡ä»½ä¸å®Œæ•´/ç½‘ç»œè¶…æ—¶` | `ç½‘ç»œé—®é¢˜/è®¤è¯å¤±è´¥` | `æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒSSHå¯†é’¥` |

### 10.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ æ ¸å¿ƒåŸåˆ™**
- **æ¸è¿›å¼éƒ¨ç½²**ï¼šä»æµ‹è¯•ç¯å¢ƒåˆ°ç”Ÿäº§ç¯å¢ƒé€æ­¥æ¨è¿›
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šç¡®ä¿ä¸å½±å“ç”Ÿäº§æœåŠ¡çš„æ­£å¸¸è¿è¡Œ
- **å®‰å…¨ç¬¬ä¸€**ï¼šæ‰€æœ‰å¤„ç†è¿‡ç¨‹éƒ½è¦è€ƒè™‘æ•°æ®å®‰å…¨
- **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**ï¼šå‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜å¤„ç†æ•ˆç‡
- **åˆè§„å¯¼å‘**ï¼šç¡®ä¿ç¬¦åˆç›¸å…³æ³•è§„è¦æ±‚

**å®é™…åº”ç”¨ä»·å€¼**
- **æ•…éšœè¯Šæ–­åŠ é€Ÿ**ï¼šå¿«é€Ÿå®šä½ç”Ÿäº§ç¯å¢ƒé—®é¢˜æ ¹æº
- **ç³»ç»Ÿç¨³å®šæ€§æå‡**ï¼šåŠæ—¶å‘ç°å’Œè§£å†³æ½œåœ¨é—®é¢˜
- **è¿ç»´æ•ˆç‡ä¼˜åŒ–**ï¼šè‡ªåŠ¨åŒ–å¤„ç†å‡å°‘äººå·¥å·¥ä½œé‡
- **åˆè§„é£é™©é™ä½**ï¼šè§„èŒƒåŒ–å¤„ç†æ»¡è¶³å®¡è®¡è¦æ±‚

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç”Ÿäº§ç¯å¢ƒcore dumpéœ€è¦åœ¨æ€§èƒ½ã€å®‰å…¨ã€åˆè§„é—´å¹³è¡¡
- è‡ªåŠ¨åŒ–æ˜¯å…³é”®ï¼Œä»æ”¶é›†åˆ°åˆ†æå…¨æµç¨‹è‡ªåŠ¨åŒ–
- å®‰å…¨ä¿æŠ¤è´¯ç©¿å§‹ç»ˆï¼Œæ•°æ®è„±æ•å’Œè®¿é—®æ§åˆ¶ä¸å¯å¿½è§†
- åˆ†é˜¶æ®µéƒ¨ç½²é™ä½é£é™©ï¼Œç›‘æ§å‘Šè­¦ä¿éšœåŠæ—¶å“åº”