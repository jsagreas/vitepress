---
title: 4ã€æ ¸å¿ƒè½¬å‚¨ç”Ÿæˆé…ç½®
---
## ğŸ“š ç›®å½•

1. [æ ¸å¿ƒè½¬å‚¨åŸºæœ¬æ¦‚å¿µ](#1-æ ¸å¿ƒè½¬å‚¨åŸºæœ¬æ¦‚å¿µ)
2. [core_patternæ ¸å¿ƒé…ç½®](#2-core_patternæ ¸å¿ƒé…ç½®)
3. [ulimitæ ¸å¿ƒè½¬å‚¨å¤§å°æ§åˆ¶](#3-ulimitæ ¸å¿ƒè½¬å‚¨å¤§å°æ§åˆ¶)
4. [å†…æ ¸å‚æ•°è¯¦ç»†é…ç½®](#4-å†…æ ¸å‚æ•°è¯¦ç»†é…ç½®)
5. [åº”ç”¨ç¨‹åºè½¬å‚¨è®¾ç½®](#5-åº”ç”¨ç¨‹åºè½¬å‚¨è®¾ç½®)
6. [ç³»ç»Ÿçº§å…¨å±€é…ç½®](#6-ç³»ç»Ÿçº§å…¨å±€é…ç½®)
7. [ç”¨æˆ·çº§ä¸ªäººè®¾ç½®](#7-ç”¨æˆ·çº§ä¸ªäººè®¾ç½®)
8. [ä¸´æ—¶ä¸æ°¸ä¹…é…ç½®](#8-ä¸´æ—¶ä¸æ°¸ä¹…é…ç½®)
9. [å®é™…æ¡ˆä¾‹ä¸è°ƒè¯•](#9-å®é™…æ¡ˆä¾‹ä¸è°ƒè¯•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æ ¸å¿ƒè½¬å‚¨åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ ¸å¿ƒè½¬å‚¨


**æ ¸å¿ƒè½¬å‚¨ï¼ˆCore Dumpï¼‰** æ˜¯ç¨‹åºå´©æºƒæ—¶ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„å†…å­˜æ˜ åƒæ–‡ä»¶ï¼ŒåŒ…å«äº†ç¨‹åºå´©æºƒç¬é—´çš„å®Œæ•´å†…å­˜çŠ¶æ€ã€‚

```
ç¨‹åºè¿è¡ŒçŠ¶æ€ç¤ºæ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç¨‹åºå†…å­˜ç©ºé—´         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»£ç æ®µ (text)          â”‚ â† ç¨‹åºæŒ‡ä»¤
â”‚  æ•°æ®æ®µ (data)          â”‚ â† å…¨å±€å˜é‡
â”‚  å †åŒº (heap)            â”‚ â† åŠ¨æ€åˆ†é…
â”‚  æ ˆåŒº (stack)           â”‚ â† å‡½æ•°è°ƒç”¨
â”‚  å…±äº«åº“ (libs)          â”‚ â† åŠ¨æ€é“¾æ¥åº“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ ç¨‹åºå´©æºƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     coreæ–‡ä»¶            â”‚ â† å®Œæ•´å†…å­˜é•œåƒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒè½¬å‚¨çš„ä½œç”¨


**ğŸ¯ è°ƒè¯•ä»·å€¼**
- **é—®é¢˜å®šä½**ï¼šå‡†ç¡®æ‰¾åˆ°ç¨‹åºå´©æºƒçš„ä½ç½®å’ŒåŸå› 
- **å˜é‡æŸ¥çœ‹**ï¼šæ£€æŸ¥å´©æºƒæ—¶æ‰€æœ‰å˜é‡çš„å€¼
- **è°ƒç”¨å †æ ˆ**ï¼šåˆ†æå‡½æ•°è°ƒç”¨è·¯å¾„
- **å†…å­˜çŠ¶æ€**ï¼šäº†è§£å†…å­˜ä½¿ç”¨æƒ…å†µ

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
```bash
# å…¸å‹çš„ç¨‹åºå´©æºƒåœºæ™¯
$ ./my_program
Segmentation fault (core dumped)

# ç”Ÿæˆçš„coreæ–‡ä»¶å¯ä»¥ç”¨äºè°ƒè¯•
$ gdb ./my_program core.12345
(gdb) bt          # æŸ¥çœ‹è°ƒç”¨å †æ ˆ
(gdb) print var   # æŸ¥çœ‹å˜é‡å€¼
```

### 1.3 è½¬å‚¨è§¦å‘æ¡ä»¶


ç¨‹åºåœ¨ä»¥ä¸‹æƒ…å†µä¼šç”Ÿæˆæ ¸å¿ƒè½¬å‚¨ï¼š

| **ä¿¡å·ç±»å‹** | **è§¦å‘åŸå› ** | **å¸¸è§åœºæ™¯** |
|-------------|-------------|-------------|
| `SIGSEGV` | è®¿é—®éæ³•å†…å­˜åœ°å€ | ç©ºæŒ‡é’ˆè§£å¼•ç”¨ã€æ•°ç»„è¶Šç•Œ |
| `SIGFPE` | æµ®ç‚¹å¼‚å¸¸ | é™¤é›¶é”™è¯¯ã€æº¢å‡º |
| `SIGBUS` | æ€»çº¿é”™è¯¯ | å†…å­˜å¯¹é½é—®é¢˜ |
| `SIGABRT` | ç¨‹åºä¸»åŠ¨ç»ˆæ­¢ | assertå¤±è´¥ã€abort()è°ƒç”¨ |
| `SIGQUIT` | é€€å‡ºä¿¡å· | Ctrl+\ ç»„åˆé”® |

---

## 2. âš™ï¸ core_patternæ ¸å¿ƒé…ç½®


### 2.1 core_patterné…ç½®æ–‡ä»¶


`/proc/sys/kernel/core_pattern` æ˜¯æ§åˆ¶æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ç”Ÿæˆä½ç½®å’Œå‘½åçš„å…³é”®é…ç½®ã€‚

**ğŸ“ æŸ¥çœ‹å½“å‰é…ç½®**
```bash
# æŸ¥çœ‹å½“å‰core_patternè®¾ç½®
$ cat /proc/sys/kernel/core_pattern
|/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e

# æŸ¥çœ‹æ˜¯å¦å¯ç”¨systemd-coredump
$ systemctl status systemd-coredump
```

### 2.2 patternæ ¼å¼è¯´æ˜


**ğŸ”¸ ç›´æ¥æ–‡ä»¶æ¨¡å¼**
```bash
# è®¾ç½®coreæ–‡ä»¶ç›´æ¥ä¿å­˜åˆ°æŒ‡å®šç›®å½•
echo '/tmp/core.%e.%p.%t' > /proc/sys/kernel/core_pattern
```

**ğŸ”¸ ç®¡é“æ¨¡å¼ï¼ˆæ¨èï¼‰**
```bash
# é€šè¿‡ç®¡é“äº¤ç»™ä¸“é—¨çš„å¤„ç†ç¨‹åº
echo '|/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e' > /proc/sys/kernel/core_pattern
```

### 2.3 æ ¼å¼åŒ–å‚æ•°è¯¦è§£


| **å‚æ•°** | **å«ä¹‰** | **ç¤ºä¾‹å€¼** |
|---------|----------|-----------|
| `%p` | è¿›ç¨‹PID | 12345 |
| `%P` | å…¨å±€PIDï¼ˆå‘½åç©ºé—´ä¸­ï¼‰ | 12345 |
| `%u` | ç”¨æˆ·ID | 1000 |
| `%g` | ç»„ID | 1000 |
| `%s` | å¯¼è‡´è½¬å‚¨çš„ä¿¡å·ç¼–å· | 11 (SIGSEGV) |
| `%t` | è½¬å‚¨æ—¶é—´æˆ³ | 1694764800 |
| `%h` | ä¸»æœºå | myserver |
| `%e` | å¯æ‰§è¡Œæ–‡ä»¶å | my_program |
| `%E` | å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼ˆ/æ›¿æ¢ä¸º!ï¼‰ | !usr!bin!my_program |
| `%c` | æ ¸å¿ƒæ–‡ä»¶å¤§å°é™åˆ¶ | 0 (æ— é™åˆ¶) |

**ğŸ’¡ å®é™…é…ç½®ç¤ºä¾‹**
```bash
# ç®€å•æ–‡ä»¶å‘½å
echo '/var/crash/core.%e.%p.%t' > /proc/sys/kernel/core_pattern

# ç”Ÿæˆçš„æ–‡ä»¶åç¤ºä¾‹ï¼š/var/crash/core.httpd.12345.1694764800

# æŒ‰ç”¨æˆ·åˆ†ç±»
echo '/var/crash/%u/core.%e.%p' > /proc/sys/kernel/core_pattern

# ç”Ÿæˆçš„æ–‡ä»¶ï¼š/var/crash/1000/core.httpd.12345
```

### 2.4 systemd-coredumpé›†æˆ


**ğŸ”§ ç°ä»£Linuxç³»ç»Ÿæ¨èé…ç½®**
```bash
# å¯ç”¨systemd-coredumpï¼ˆå¤§å¤šæ•°ç°ä»£å‘è¡Œç‰ˆçš„é»˜è®¤é…ç½®ï¼‰
echo '|/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e' > /proc/sys/kernel/core_pattern

# é…ç½®systemd-coredumpè¡Œä¸º
# ç¼–è¾‘ /etc/systemd/coredump.conf
[Coredump]
Storage=external          # ä¿å­˜åˆ°ç£ç›˜
Compress=yes             # å‹ç¼©coreæ–‡ä»¶
ProcessSizeMax=2G        # å•ä¸ªè¿›ç¨‹æœ€å¤§è½¬å‚¨å¤§å°
ExternalSizeMax=2G       # å¤–éƒ¨å­˜å‚¨æœ€å¤§å¤§å°
JournalSizeMax=767M      # æ—¥å¿—å­˜å‚¨æœ€å¤§å¤§å°
MaxUse=1G               # æ€»å…±ä½¿ç”¨çš„æœ€å¤§ç£ç›˜ç©ºé—´
```

---

## 3. ğŸ“ ulimitæ ¸å¿ƒè½¬å‚¨å¤§å°æ§åˆ¶


### 3.1 ulimitåŸºæœ¬æ¦‚å¿µ


**ulimit** æ§åˆ¶ç”¨æˆ·è¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„ç³»ç»Ÿèµ„æºé™åˆ¶ï¼Œå…¶ä¸­ `-c` å‚æ•°ä¸“é—¨æ§åˆ¶æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶çš„å¤§å°ã€‚

**ğŸ” æŸ¥çœ‹å½“å‰é™åˆ¶**
```bash
# æŸ¥çœ‹æ ¸å¿ƒè½¬å‚¨å¤§å°é™åˆ¶
$ ulimit -c
0                    # 0è¡¨ç¤ºç¦ç”¨æ ¸å¿ƒè½¬å‚¨

# æŸ¥çœ‹æ‰€æœ‰èµ„æºé™åˆ¶
$ ulimit -a
core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
```

### 3.2 è®¾ç½®æ ¸å¿ƒè½¬å‚¨å¤§å°


**ğŸ”¸ ä¸´æ—¶è®¾ç½®ï¼ˆå½“å‰ä¼šè¯ï¼‰**
```bash
# å¯ç”¨æ ¸å¿ƒè½¬å‚¨ï¼Œæ— å¤§å°é™åˆ¶
$ ulimit -c unlimited

# è®¾ç½®å…·ä½“å¤§å°é™åˆ¶ï¼ˆä»¥KBä¸ºå•ä½ï¼‰
$ ulimit -c 102400     # é™åˆ¶ä¸º100MB

# éªŒè¯è®¾ç½®
$ ulimit -c
unlimited
```

**ğŸ”¸ ä¸ºç¨‹åºæµ‹è¯•å¯ç”¨è½¬å‚¨**
```bash
#!/bin/bash
# æµ‹è¯•è„šæœ¬ï¼šå¯ç”¨core dumpåè¿è¡Œç¨‹åº

# ä¸´æ—¶å¯ç”¨æ ¸å¿ƒè½¬å‚¨
ulimit -c unlimited

# è¿è¡Œå¯èƒ½å´©æºƒçš„ç¨‹åº
./test_program

# æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†coreæ–‡ä»¶
if [ -f core.* ]; then
    echo "Core dump generated successfully"
    ls -lh core.*
fi
```

### 3.3 ä¸åŒå•ä½çš„è®¾ç½®


```bash
# å¤§å°å•ä½è¯´æ˜
ulimit -c 0           # ç¦ç”¨ï¼ˆ0å—ï¼‰
ulimit -c 1024        # 1MBï¼ˆ1024 * 1KBå—ï¼‰
ulimit -c 102400      # 100MB
ulimit -c unlimited   # æ— é™åˆ¶ï¼ˆæ¨èç”¨äºè°ƒè¯•ï¼‰

# å®é™…æ–‡ä»¶å¤§å°è®¡ç®—
# ulimit -c çš„å€¼ Ã— 1024 å­—èŠ‚ = å®é™…æ–‡ä»¶å¤§å°é™åˆ¶
```

### 3.4 ç”¨æˆ·vsç³»ç»Ÿé™åˆ¶


**ğŸ“Š é™åˆ¶å±‚çº§å…³ç³»**
```
ç³»ç»Ÿç¡¬é™åˆ¶ (hard limit)
    â†“
ç”¨æˆ·è½¯é™åˆ¶ (soft limit)  
    â†“
è¿›ç¨‹å®é™…ä½¿ç”¨

ç¡¬é™åˆ¶ï¼šç³»ç»Ÿç®¡ç†å‘˜è®¾ç½®çš„ç»å¯¹ä¸Šé™
è½¯é™åˆ¶ï¼šç”¨æˆ·å¯ä»¥è°ƒæ•´çš„å½“å‰é™åˆ¶ï¼ˆä¸èƒ½è¶…è¿‡ç¡¬é™åˆ¶ï¼‰
```

**ğŸ”§ æŸ¥çœ‹å’Œè®¾ç½®ç¡¬é™åˆ¶**
```bash
# æŸ¥çœ‹è½¯é™åˆ¶å’Œç¡¬é™åˆ¶
$ ulimit -c -S        # è½¯é™åˆ¶
$ ulimit -c -H        # ç¡¬é™åˆ¶

# è®¾ç½®è½¯é™åˆ¶ï¼ˆä¸èƒ½è¶…è¿‡ç¡¬é™åˆ¶ï¼‰
$ ulimit -c -S unlimited

# æ™®é€šç”¨æˆ·æ— æ³•ä¿®æ”¹ç¡¬é™åˆ¶ï¼Œéœ€è¦rootæƒé™
```

---

## 4. âš¡ å†…æ ¸å‚æ•°è¯¦ç»†é…ç½®


### 4.1 core_pipe_limitç®¡é“é™åˆ¶


**kernel.core_pipe_limit** æ§åˆ¶åŒæ—¶å¯ä»¥å¤„ç†çš„æ ¸å¿ƒè½¬å‚¨ç®¡é“æ•°é‡ã€‚

```bash
# æŸ¥çœ‹å½“å‰ç®¡é“é™åˆ¶
$ sysctl kernel.core_pipe_limit
kernel.core_pipe_limit = 0

# è®¾ç½®ç®¡é“é™åˆ¶
$ echo 'kernel.core_pipe_limit = 16' >> /etc/sysctl.conf
$ sysctl -p

# ä¸´æ—¶è®¾ç½®
$ sysctl -w kernel.core_pipe_limit=16
```

**ğŸ“ˆ ç®¡é“é™åˆ¶çš„å½±å“**
```
åœºæ™¯åˆ†æï¼š
â”œâ”€ core_pipe_limit = 0    # æ— é™åˆ¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½
â”œâ”€ core_pipe_limit = 1    # åŒæ—¶åªèƒ½å¤„ç†1ä¸ªcore dump
â””â”€ core_pipe_limit = 16   # å¹³è¡¡æ€§èƒ½å’Œèµ„æºä½¿ç”¨

æ¨èè®¾ç½®ï¼š
- å¼€å‘ç¯å¢ƒï¼š16-32
- ç”Ÿäº§ç¯å¢ƒï¼š4-8
- é«˜è´Ÿè½½æœåŠ¡å™¨ï¼š2-4
```

### 4.2 core_uses_pidæ–‡ä»¶åé€‰é¡¹


**kernel.core_uses_pid** æ§åˆ¶æ˜¯å¦åœ¨æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶åä¸­åŒ…å«è¿›ç¨‹PIDã€‚

```bash
# æŸ¥çœ‹å½“å‰è®¾ç½®
$ sysctl kernel.core_uses_pid
kernel.core_uses_pid = 1

# è®¾ç½®PIDé€‰é¡¹
$ sysctl -w kernel.core_uses_pid=1    # å¯ç”¨PID
$ sysctl -w kernel.core_uses_pid=0    # ç¦ç”¨PID
```

**ğŸ”¸ æ–‡ä»¶å‘½åå¯¹æ¯”**
```bash
# kernel.core_uses_pid = 1 æ—¶
core.12345           # åŒ…å«PID
core.my_program.12345

# kernel.core_uses_pid = 0 æ—¶  
core                 # ä¸åŒ…å«PIDï¼ˆå¯èƒ½è¢«è¦†ç›–ï¼‰
core.my_program

# æ³¨æ„ï¼šç°ä»£ç³»ç»Ÿé€šå¸¸ä½¿ç”¨core_patternè€Œä¸æ˜¯core_uses_pid
```

### 4.3 å…¶ä»–ç›¸å…³å†…æ ¸å‚æ•°


```bash
# æŸ¥çœ‹æ‰€æœ‰coreç›¸å…³å‚æ•°
$ sysctl -a | grep core
kernel.core_pattern = |/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e
kernel.core_pipe_limit = 0
kernel.core_uses_pid = 1

# è¿›ç¨‹ç›¸å…³é™åˆ¶
$ sysctl -a | grep pid
kernel.pid_max = 4194304              # æœ€å¤§PIDæ•°
kernel.threads-max = 1030093          # æœ€å¤§çº¿ç¨‹æ•°
```

**âš™ï¸ å®Œæ•´çš„å†…æ ¸å‚æ•°é…ç½®ç¤ºä¾‹**
```bash
# æ·»åŠ åˆ° /etc/sysctl.conf
kernel.core_pattern = |/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e
kernel.core_pipe_limit = 16
kernel.core_uses_pid = 1

# åº”ç”¨é…ç½®
$ sysctl -p
```

---

## 5. ğŸ”§ åº”ç”¨ç¨‹åºè½¬å‚¨è®¾ç½®


### 5.1 ç¨‹åºå¯åŠ¨å‰é…ç½®


åœ¨å¯åŠ¨å®¹æ˜“å´©æºƒçš„ç¨‹åºä¹‹å‰ï¼Œéœ€è¦æ­£ç¡®é…ç½®è½¬å‚¨ç¯å¢ƒã€‚

**ğŸ“ å¯åŠ¨è„šæœ¬æ¨¡æ¿**
```bash
#!/bin/bash
# åº”ç”¨ç¨‹åºcore dumpå¯ç”¨è„šæœ¬

APP_NAME="my_application"
LOG_DIR="/var/log/${APP_NAME}"
CORE_DIR="/var/crash/${APP_NAME}"

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p "${LOG_DIR}" "${CORE_DIR}"

# è®¾ç½®æ ¸å¿ƒè½¬å‚¨
ulimit -c unlimited                    # å¯ç”¨è½¬å‚¨
export CORE_PATTERN="${CORE_DIR}/core.%e.%p.%t"

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæŸäº›ç¨‹åºéœ€è¦ï¼‰
export MALLOC_CHECK_=2                 # å¯ç”¨mallocè°ƒè¯•
export LIBC_FATAL_STDERR_=1           # é”™è¯¯è¾“å‡ºåˆ°stderr

# å¯åŠ¨åº”ç”¨
echo "Starting ${APP_NAME} with core dump enabled..."
echo "Core files will be saved to: ${CORE_DIR}"
exec ./${APP_NAME} "$@"
```

### 5.2 æœåŠ¡é…ç½®é›†æˆ


**ğŸ”¸ systemdæœåŠ¡é…ç½®**
```ini
# /etc/systemd/system/myapp.service
[Unit]
Description=My Application with Core Dump
After=network.target

[Service]
Type=simple
User=myapp
Group=myapp
WorkingDirectory=/opt/myapp
ExecStart=/opt/myapp/bin/myapp
Restart=on-failure

# æ ¸å¿ƒè½¬å‚¨é…ç½®
LimitCORE=infinity                     # å¯ç”¨æ ¸å¿ƒè½¬å‚¨
Environment=MALLOC_CHECK_=2            # å†…å­˜è°ƒè¯•
RuntimeDirectory=myapp                 # è¿è¡Œæ—¶ç›®å½•
RuntimeDirectoryMode=0755

[Install]
WantedBy=multi-user.target
```

**ğŸ”¸ Dockerå®¹å™¨é…ç½®**
```bash
# å®¹å™¨å¯åŠ¨æ—¶å¯ç”¨core dump
docker run -d \
  --name myapp \
  --ulimit core=-1 \                   # æ— é™åˆ¶coreæ–‡ä»¶å¤§å°
  -v /tmp/cores:/tmp/cores \           # æŒ‚è½½coreæ–‡ä»¶ç›®å½•
  -e MALLOC_CHECK_=2 \                 # å†…å­˜è°ƒè¯•ç¯å¢ƒå˜é‡
  myapp:latest

# æˆ–åœ¨Dockerfileä¸­è®¾ç½®
# Dockerfile
FROM ubuntu:20.04
RUN echo '* soft core unlimited' >> /etc/security/limits.conf
RUN echo '* hard core unlimited' >> /etc/security/limits.conf
```

### 5.3 ç¼–ç¨‹è¯­è¨€ç‰¹å®šè®¾ç½®


**ğŸ”¸ C/C++ç¨‹åº**
```c
#include <sys/resource.h>
#include <signal.h>

void enable_core_dump() {
    struct rlimit rlim;
    
    // è®¾ç½®æ ¸å¿ƒè½¬å‚¨å¤§å°ä¸ºæ— é™åˆ¶
    rlim.rlim_cur = RLIM_INFINITY;
    rlim.rlim_max = RLIM_INFINITY;
    
    if (setrlimit(RLIMIT_CORE, &rlim) == 0) {
        printf("Core dump enabled\n");
    } else {
        perror("Failed to enable core dump");
    }
}

int main() {
    enable_core_dump();
    
    // ä½ çš„ç¨‹åºé€»è¾‘
    return 0;
}
```

**ğŸ”¸ Javaç¨‹åº**
```bash
# Javaç¨‹åºå¯ç”¨core dump
java -XX:+CreateCoredumpOnCrash \
     -XX:+PrintGCDetails \
     -XX:+PrintGCTimeStamps \
     -Xmx2g \
     MyApplication

# JVM crashæ—¶ä¼šç”Ÿæˆhs_err_pid*.logå’Œcoreæ–‡ä»¶
```

---

## 6. ğŸŒ ç³»ç»Ÿçº§å…¨å±€é…ç½®


### 6.1 å…¨ç³»ç»Ÿé…ç½®æ–‡ä»¶


ç³»ç»Ÿçº§é…ç½®å½±å“æ‰€æœ‰ç”¨æˆ·å’Œè¿›ç¨‹çš„æ ¸å¿ƒè½¬å‚¨è¡Œä¸ºã€‚

**ğŸ“ ä¸»è¦é…ç½®æ–‡ä»¶ä½ç½®**
```bash
/proc/sys/kernel/core_pattern          # æ ¸å¿ƒè½¬å‚¨è·¯å¾„æ¨¡å¼
/etc/sysctl.conf                       # å†…æ ¸å‚æ•°é…ç½®
/etc/security/limits.conf              # ç”¨æˆ·èµ„æºé™åˆ¶
/etc/systemd/coredump.conf            # systemdè½¬å‚¨é…ç½®
```

### 6.2 limits.confå…¨å±€é™åˆ¶


**ç¼–è¾‘ `/etc/security/limits.conf`**
```bash
# ä¸ºæ‰€æœ‰ç”¨æˆ·è®¾ç½®æ ¸å¿ƒè½¬å‚¨é™åˆ¶
* soft core unlimited      # è½¯é™åˆ¶ï¼šæ— é™åˆ¶
* hard core unlimited      # ç¡¬é™åˆ¶ï¼šæ— é™åˆ¶

# ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®
myuser soft core 0         # ç¦ç”¨ç‰¹å®šç”¨æˆ·çš„è½¬å‚¨
root   hard core unlimited # rootç”¨æˆ·æ— é™åˆ¶

# ä¸ºç‰¹å®šç»„è®¾ç½®
@developers soft core unlimited    # developersç»„æ— é™åˆ¶
@production hard core 102400       # productionç»„é™åˆ¶100MB
```

**ğŸ“Š limits.confè¯­æ³•è¯´æ˜**
```
æ ¼å¼ï¼š<domain> <type> <item> <value>

domain: ç”¨æˆ·åã€ç»„å(@group)ã€é€šé…ç¬¦(*)
type:   soft(è½¯é™åˆ¶)ã€hard(ç¡¬é™åˆ¶)
item:   core(æ ¸å¿ƒè½¬å‚¨)ã€nofile(æ–‡ä»¶æ•°)ç­‰
value:  æ•°å€¼æˆ–unlimited
```

### 6.3 ç³»ç»ŸæœåŠ¡é…ç½®


**ğŸ”§ é…ç½®systemd-coredumpæœåŠ¡**
```bash
# ç¼–è¾‘ /etc/systemd/coredump.conf
[Coredump]
Storage=external                       # å­˜å‚¨åˆ°ç£ç›˜
Compress=yes                          # å¯ç”¨å‹ç¼©
ProcessSizeMax=2G                     # å•è¿›ç¨‹æœ€å¤§å¤§å°
ExternalSizeMax=2G                    # å¤–éƒ¨å­˜å‚¨æœ€å¤§å¤§å°
JournalSizeMax=767M                   # æ—¥å¿—æœ€å¤§å¤§å°
MaxUse=1G                            # æœ€å¤§ç£ç›˜ä½¿ç”¨
KeepFree=1G                          # ä¿æŒå¯ç”¨ç©ºé—´

# é‡æ–°åŠ è½½é…ç½®
$ systemctl daemon-reload
$ systemctl restart systemd-coredump
```

### 6.4 å­˜å‚¨ç›®å½•è§„åˆ’


**ğŸ“‚ æ¨èçš„ç›®å½•ç»“æ„**
```bash
# åˆ›å»ºç»Ÿä¸€çš„coreæ–‡ä»¶å­˜å‚¨ç»“æ„
/var/crash/
â”œâ”€â”€ system/                    # ç³»ç»Ÿçº§æ ¸å¿ƒè½¬å‚¨
â”œâ”€â”€ applications/              # åº”ç”¨ç¨‹åºè½¬å‚¨
â”‚   â”œâ”€â”€ httpd/
â”‚   â”œâ”€â”€ mysql/
â”‚   â””â”€â”€ custom_app/
â””â”€â”€ users/                     # ç”¨æˆ·çº§è½¬å‚¨
    â”œâ”€â”€ 1000/                 # æŒ‰UIDåˆ†ç±»
    â””â”€â”€ 1001/

# è®¾ç½®æƒé™å’Œæ‰€æœ‰è€…
$ mkdir -p /var/crash/{system,applications,users}
$ chmod 755 /var/crash
$ chmod 1777 /var/crash/users  # ç±»ä¼¼/tmpçš„æƒé™
```

---

## 7. ğŸ‘¤ ç”¨æˆ·çº§ä¸ªäººè®¾ç½®


### 7.1 ä¸ªäººç¯å¢ƒé…ç½®


ç”¨æˆ·å¯ä»¥åœ¨ä¸ªäººç¯å¢ƒä¸­é…ç½®æ ¸å¿ƒè½¬å‚¨ï¼Œè€Œä¸å½±å“ç³»ç»Ÿå…¨å±€è®¾ç½®ã€‚

**ğŸ”¸ shellé…ç½®æ–‡ä»¶è®¾ç½®**
```bash
# æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.profile
# å¯ç”¨ä¸ªäººcore dumpè®¾ç½®
ulimit -c unlimited

# è®¾ç½®ä¸ªäººcoreæ–‡ä»¶å­˜å‚¨ä½ç½®ï¼ˆå¦‚æœæœ‰æƒé™ï¼‰
export CORE_DIR="$HOME/debug/cores"
mkdir -p "$CORE_DIR"

# æ·»åŠ è°ƒè¯•ç›¸å…³ç¯å¢ƒå˜é‡
export MALLOC_CHECK_=2         # å†…å­˜è°ƒè¯•
export MALLOC_PERTURB_=42     # å†…å­˜å¡«å……æ¨¡å¼
export LIBC_FATAL_STDERR_=1   # è‡´å‘½é”™è¯¯è¾“å‡º
```

### 7.2 å¼€å‘ç¯å¢ƒä¸“ç”¨é…ç½®


**ğŸ“ å¼€å‘è€…ä¸ªäººé…ç½®è„šæœ¬**
```bash
#!/bin/bash
# ~/.local/bin/enable-debug-env

# å¼€å‘è°ƒè¯•ç¯å¢ƒè®¾ç½®è„šæœ¬
setup_debug_env() {
    local debug_dir="$HOME/.debug"
    
    # åˆ›å»ºè°ƒè¯•ç›®å½•
    mkdir -p "$debug_dir"/{cores,logs,dumps}
    
    # è®¾ç½®æ ¸å¿ƒè½¬å‚¨
    ulimit -c unlimited
    
    # å¼€å‘ç¯å¢ƒå˜é‡
    export DEBUG=1
    export MALLOC_CHECK_=2
    export ASAN_SYMBOLIZER_PATH=/usr/bin/llvm-symbolizer
    
    # æ˜¾ç¤ºå½“å‰è®¾ç½®
    echo "Debug environment enabled:"
    echo "  Core dump size: $(ulimit -c)"
    echo "  Debug directory: $debug_dir"
    echo "  MALLOC_CHECK_: $MALLOC_CHECK_"
}

# å¦‚æœç›´æ¥è¿è¡Œè„šæœ¬ï¼Œåˆ™è®¾ç½®ç¯å¢ƒ
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    setup_debug_env
fi
```

### 7.3 é¡¹ç›®ç‰¹å®šé…ç½®


**ğŸ”¸ é¡¹ç›®çº§åˆ«çš„è½¬å‚¨é…ç½®**
```bash
# é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ debug.sh
#!/bin/bash
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CORE_DIR="$PROJECT_ROOT/.debug/cores"

# åˆ›å»ºé¡¹ç›®ç‰¹å®šçš„è°ƒè¯•ç›®å½•
mkdir -p "$CORE_DIR"

# è®¾ç½®é¡¹ç›®ç¯å¢ƒ
export ULIMIT_CORE_SIZE=unlimited
export PROJECT_CORE_DIR="$CORE_DIR"

# å¯ç”¨è½¬å‚¨
ulimit -c unlimited

echo "Project debug environment ready"
echo "Core files will be saved to: $CORE_DIR"

# å¯ä»¥åœ¨è¿™é‡Œå¯åŠ¨ç¨‹åº
if [ $# -gt 0 ]; then
    exec "$@"
fi
```

---

## 8. â° ä¸´æ—¶ä¸æ°¸ä¹…é…ç½®


### 8.1 ä¸´æ—¶é…ç½®æ–¹æ³•


ä¸´æ—¶é…ç½®åªåœ¨å½“å‰ä¼šè¯ä¸­æœ‰æ•ˆï¼Œé‡å¯åå¤±æ•ˆã€‚

**ğŸ”¸ ä¸´æ—¶å†…æ ¸å‚æ•°è®¾ç½®**
```bash
# ä¸´æ—¶ä¿®æ”¹core_pattern
echo '/tmp/core.%e.%p.%t' > /proc/sys/kernel/core_pattern

# ä¸´æ—¶ä¿®æ”¹å…¶ä»–å†…æ ¸å‚æ•°
sysctl -w kernel.core_pipe_limit=16
sysctl -w kernel.core_uses_pid=1

# ä¸´æ—¶è®¾ç½®ç”¨æˆ·é™åˆ¶
ulimit -c unlimited

# æŸ¥çœ‹ä¸´æ—¶è®¾ç½®æ•ˆæœ
echo "Current settings:"
echo "  core_pattern: $(cat /proc/sys/kernel/core_pattern)"
echo "  core_pipe_limit: $(sysctl -n kernel.core_pipe_limit)"
echo "  ulimit -c: $(ulimit -c)"
```

**ğŸ’¡ ä¸´æ—¶é…ç½®çš„ä½¿ç”¨åœºæ™¯**
- ç´§æ€¥è°ƒè¯•é—®é¢˜
- æµ‹è¯•ä¸åŒé…ç½®æ•ˆæœ
- ä¸´æ—¶å¯ç”¨è°ƒè¯•åŠŸèƒ½
- é¿å…å½±å“ç”Ÿäº§ç¯å¢ƒ

### 8.2 æ°¸ä¹…é…ç½®æ–¹æ³•


æ°¸ä¹…é…ç½®ä¼šåœ¨ç³»ç»Ÿé‡å¯åç»§ç»­ç”Ÿæ•ˆã€‚

**ğŸ”¸ æ°¸ä¹…å†…æ ¸å‚æ•°é…ç½®**
```bash
# ç¼–è¾‘ /etc/sysctl.conf
echo 'kernel.core_pattern = |/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e' >> /etc/sysctl.conf
echo 'kernel.core_pipe_limit = 16' >> /etc/sysctl.conf
echo 'kernel.core_uses_pid = 1' >> /etc/sysctl.conf

# ç«‹å³åº”ç”¨é…ç½®
sysctl -p

# éªŒè¯é…ç½®å·²ç”Ÿæ•ˆ
sysctl kernel.core_pattern kernel.core_pipe_limit kernel.core_uses_pid
```

**ğŸ”¸ æ°¸ä¹…ç”¨æˆ·é™åˆ¶é…ç½®**
```bash
# ç¼–è¾‘ /etc/security/limits.conf
echo '* soft core unlimited' >> /etc/security/limits.conf
echo '* hard core unlimited' >> /etc/security/limits.conf

# å¯¹äºsystemdç®¡ç†çš„æœåŠ¡ï¼Œè¿˜éœ€è¦ç¼–è¾‘
# /etc/systemd/system.conf æˆ– /etc/systemd/user.conf
echo 'DefaultLimitCORE=infinity' >> /etc/systemd/system.conf
```

### 8.3 é…ç½®éªŒè¯å’Œæµ‹è¯•


**ğŸ§ª é…ç½®éªŒè¯è„šæœ¬**
```bash
#!/bin/bash
# éªŒè¯æ ¸å¿ƒè½¬å‚¨é…ç½®çš„å®Œæ•´æ€§

check_config() {
    echo "=== Core Dump Configuration Check ==="
    
    # æ£€æŸ¥å†…æ ¸å‚æ•°
    echo "1. Kernel parameters:"
    echo "   core_pattern: $(cat /proc/sys/kernel/core_pattern)"
    echo "   core_pipe_limit: $(sysctl -n kernel.core_pipe_limit)"
    echo "   core_uses_pid: $(sysctl -n kernel.core_uses_pid)"
    
    # æ£€æŸ¥ç”¨æˆ·é™åˆ¶
    echo "2. User limits:"
    echo "   Current ulimit -c: $(ulimit -c)"
    echo "   Hard limit: $(ulimit -H -c)"
    
    # æ£€æŸ¥systemdé…ç½®
    echo "3. Systemd coredump:"
    if systemctl is-active systemd-coredump >/dev/null 2>&1; then
        echo "   systemd-coredump: active"
    else
        echo "   systemd-coredump: inactive"
    fi
    
    # æ£€æŸ¥å­˜å‚¨ç›®å½•
    echo "4. Storage directories:"
    if [ -d /var/lib/systemd/coredump ]; then
        echo "   /var/lib/systemd/coredump: exists"
        echo "   Available space: $(df -h /var/lib/systemd/coredump | tail -1 | awk '{print $4}')"
    fi
}

# æµ‹è¯•æ ¸å¿ƒè½¬å‚¨åŠŸèƒ½
test_core_dump() {
    echo "=== Testing Core Dump Generation ==="
    
    # ç¼–è¯‘ä¸€ä¸ªä¼šå´©æºƒçš„æµ‹è¯•ç¨‹åº
    cat > /tmp/test_crash.c << 'EOF'
#include <stdio.h>
int main() {
    int *p = NULL;
    printf("About to crash...\n");
    *p = 42;  // è¿™ä¼šå¯¼è‡´æ®µé”™è¯¯
    return 0;
}
EOF
    
    gcc -o /tmp/test_crash /tmp/test_crash.c
    
    # è®¾ç½®ulimitå¹¶è¿è¡Œæµ‹è¯•
    (
        ulimit -c unlimited
        cd /tmp
        ./test_crash 2>&1
    )
    
    # æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†coreæ–‡ä»¶
    if ls /tmp/core* >/dev/null 2>&1 || coredumpctl list test_crash >/dev/null 2>&1; then
        echo "âœ… Core dump test successful"
    else
        echo "âŒ Core dump test failed"
    fi
    
    # æ¸…ç†
    rm -f /tmp/test_crash /tmp/test_crash.c /tmp/core*
}

# æ‰§è¡Œæ£€æŸ¥å’Œæµ‹è¯•
check_config
echo
test_core_dump
```

---

## 9. ğŸ”§ å®é™…æ¡ˆä¾‹ä¸è°ƒè¯•


### 9.1 WebæœåŠ¡å™¨å´©æºƒè°ƒè¯•


**åœºæ™¯**ï¼šApache HTTPæœåŠ¡å™¨å¶å‘æ€§å´©æºƒï¼Œéœ€è¦ç”Ÿæˆæ ¸å¿ƒè½¬å‚¨è¿›è¡Œåˆ†æã€‚

```bash
# 1. é…ç½®ApacheæœåŠ¡çš„æ ¸å¿ƒè½¬å‚¨
# ç¼–è¾‘ /etc/systemd/system/apache2.service.d/coredump.conf
mkdir -p /etc/systemd/system/apache2.service.d
cat > /etc/systemd/system/apache2.service.d/coredump.conf << 'EOF'
[Service]
LimitCORE=infinity
Environment=MALLOC_CHECK_=2
EOF

# 2. é‡æ–°åŠ è½½systemdé…ç½®
systemctl daemon-reload
systemctl restart apache2

# 3. ç›‘æ§æ ¸å¿ƒè½¬å‚¨ç”Ÿæˆ
journalctl -u systemd-coredump -f &

# 4. å½“å´©æºƒå‘ç”Ÿæ—¶ï¼Œåˆ†æcoreæ–‡ä»¶
coredumpctl list apache2
coredumpctl gdb apache2  # ç›´æ¥è¿›å…¥gdbè°ƒè¯•
```

### 9.2 æ•°æ®åº“æœåŠ¡è°ƒè¯•


**åœºæ™¯**ï¼šMySQLæœåŠ¡å™¨åœ¨é«˜è´Ÿè½½æ—¶å´©æºƒã€‚

```bash
# 1. MySQLä¸“ç”¨æ ¸å¿ƒè½¬å‚¨é…ç½®
# ç¼–è¾‘ /etc/mysql/mysql.conf.d/debug.cnf
[mysqld]
core-file

# 2. è®¾ç½®MySQLç”¨æˆ·çš„èµ„æºé™åˆ¶
# ç¼–è¾‘ /etc/security/limits.conf
mysql soft core unlimited
mysql hard core unlimited

# 3. é…ç½®MySQL systemdæœåŠ¡
# ç¼–è¾‘ /etc/systemd/system/mysql.service.d/coredump.conf
[Service]
LimitCORE=infinity
LimitNOFILE=65535

# 4. é‡å¯MySQLæœåŠ¡
systemctl daemon-reload
systemctl restart mysql

# 5. ç›‘æ§å’Œåˆ†æ
# æŸ¥çœ‹MySQLç›¸å…³çš„æ ¸å¿ƒè½¬å‚¨
coredumpctl list mysql*

# ä½¿ç”¨ä¸“é—¨çš„MySQLè°ƒè¯•å·¥å…·
resolve_stack_dump /var/lib/mysql/hostname.err /usr/bin/mysqld
```

### 9.3 è‡ªå®šä¹‰åº”ç”¨ç¨‹åºè°ƒè¯•


**åœºæ™¯**ï¼šå¼€å‘çš„C++åº”ç”¨ç¨‹åºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­éšæœºå´©æºƒã€‚

**ğŸ”¸ åº”ç”¨ç¨‹åºé…ç½®è„šæœ¬**
```bash
#!/bin/bash
# /opt/myapp/bin/start-with-debug.sh

APP_NAME="myapp"
APP_PATH="/opt/myapp/bin/myapp"
LOG_DIR="/var/log/myapp"
CORE_DIR="/var/crash/myapp"

# åˆ›å»ºå¿…è¦çš„ç›®å½•
mkdir -p "$LOG_DIR" "$CORE_DIR"

# è®¾ç½®ç¯å¢ƒ
ulimit -c unlimited
export MALLOC_CHECK_=2
export MALLOC_PERTURB_=42

# è®°å½•å¯åŠ¨ä¿¡æ¯
echo "$(date): Starting $APP_NAME with debug enabled" >> "$LOG_DIR/debug.log"
echo "Core files will be saved to: $CORE_DIR" >> "$LOG_DIR/debug.log"

# å¯åŠ¨åº”ç”¨ç¨‹åº
exec "$APP_PATH" "$@" 2>&1 | tee -a "$LOG_DIR/output.log"
```

**ğŸ”¸ å´©æºƒåˆ†æè„šæœ¬**
```bash
#!/bin/bash
# /opt/myapp/bin/analyze-crash.sh

CORE_DIR="/var/crash/myapp"
APP_PATH="/opt/myapp/bin/myapp"

# æŸ¥æ‰¾æœ€æ–°çš„coreæ–‡ä»¶
latest_core=$(find "$CORE_DIR" -name "core.*" -type f -printf "%T@ %p\n" | sort -n | tail -1 | cut -d' ' -f2)

if [ -n "$latest_core" ]; then
    echo "Analyzing latest core dump: $latest_core"
    
    # ä½¿ç”¨gdbè¿›è¡ŒåŸºæœ¬åˆ†æ
    gdb -batch -ex "bt" -ex "info registers" -ex "quit" "$APP_PATH" "$latest_core" > /tmp/crash_analysis.txt
    
    # æå–å…³é”®ä¿¡æ¯
    echo "=== Crash Analysis Summary ==="
    echo "Core file: $latest_core"
    echo "Size: $(ls -lh "$latest_core" | awk '{print $5}')"
    echo "Timestamp: $(stat -c %y "$latest_core")"
    echo
    echo "=== Stack Trace ==="
    grep -A 20 "^#0" /tmp/crash_analysis.txt
    
    # å¦‚æœæœ‰è°ƒè¯•ç¬¦å·ï¼Œæ˜¾ç¤ºæ›´å¤šä¿¡æ¯
    if objdump -h "$APP_PATH" | grep -q debug; then
        echo "Debug symbols available - detailed analysis possible"
    else
        echo "No debug symbols - install debug package for detailed analysis"
    fi
else
    echo "No core files found in $CORE_DIR"
fi
```

### 9.4 å®¹å™¨åŒ–åº”ç”¨è°ƒè¯•


**Dockerå®¹å™¨æ ¸å¿ƒè½¬å‚¨é…ç½®**
```bash
# 1. å®¿ä¸»æœºé…ç½®
echo 'kernel.core_pattern = /tmp/cores/core.%e.%p.%h.%t' > /etc/sysctl.d/core.conf
sysctl -p /etc/sysctl.d/core.conf
mkdir -p /tmp/cores
chmod 777 /tmp/cores

# 2. å¯åŠ¨å®¹å™¨æ—¶å¯ç”¨æ ¸å¿ƒè½¬å‚¨
docker run -d \
  --name myapp-debug \
  --ulimit core=-1 \
  --security-opt seccomp=unconfined \
  -v /tmp/cores:/tmp/cores \
  -e MALLOC_CHECK_=2 \
  myapp:latest

# 3. å®¹å™¨å†…éƒ¨è°ƒè¯•
docker exec -it myapp-debug bash
ulimit -c unlimited
gdb /usr/bin/myapp /tmp/cores/core.*
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ ¸å¿ƒè½¬å‚¨ï¼šç¨‹åºå´©æºƒæ—¶çš„å†…å­˜é•œåƒï¼Œç”¨äºäº‹åè°ƒè¯•åˆ†æ
ğŸ”¸ core_patternï¼šæ§åˆ¶è½¬å‚¨æ–‡ä»¶ç”Ÿæˆä½ç½®å’Œå‘½åè§„åˆ™çš„å…³é”®é…ç½®
ğŸ”¸ ulimit -cï¼šæ§åˆ¶è½¬å‚¨æ–‡ä»¶å¤§å°é™åˆ¶çš„ç”¨æˆ·çº§è®¾ç½®
ğŸ”¸ å†…æ ¸å‚æ•°ï¼šcore_pipe_limitã€core_uses_pidç­‰ç³»ç»Ÿçº§æ§åˆ¶å‚æ•°
ğŸ”¸ é…ç½®å±‚çº§ï¼šç³»ç»Ÿçº§ â†’ ç”¨æˆ·çº§ â†’ è¿›ç¨‹çº§çš„é…ç½®ä¼˜å…ˆçº§å…³ç³»
```

### 10.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ åŸºç¡€é…ç½®æ¸…å•**
```bash
# 1. å¯ç”¨æ ¸å¿ƒè½¬å‚¨
ulimit -c unlimited

# 2. é…ç½®å­˜å‚¨ä½ç½®
echo '/var/crash/core.%e.%p.%t' > /proc/sys/kernel/core_pattern

# 3. è®¾ç½®ç³»ç»Ÿå‚æ•°
echo 'kernel.core_pipe_limit = 16' >> /etc/sysctl.conf

# 4. é…ç½®ç”¨æˆ·é™åˆ¶
echo '* soft core unlimited' >> /etc/security/limits.conf
```

**ğŸ”¹ é…ç½®éªŒè¯æ–¹æ³•**
```bash
# æ£€æŸ¥å½“å‰é…ç½®çŠ¶æ€
cat /proc/sys/kernel/core_pattern
ulimit -c
sysctl kernel.core_pipe_limit

# æµ‹è¯•é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
# è¿è¡Œä¼šå´©æºƒçš„æµ‹è¯•ç¨‹åºéªŒè¯
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š ä¸åŒåœºæ™¯çš„é…ç½®ç­–ç•¥**

| **ç¯å¢ƒç±»å‹** | **ulimitè®¾ç½®** | **å­˜å‚¨ç­–ç•¥** | **ç‰¹æ®Šé…ç½®** |
|-------------|---------------|-------------|-------------|
| **å¼€å‘ç¯å¢ƒ** | `unlimited` | æœ¬åœ°ç›®å½• | å¯ç”¨æ‰€æœ‰è°ƒè¯•é€‰é¡¹ |
| **æµ‹è¯•ç¯å¢ƒ** | `unlimited` | é›†ä¸­å­˜å‚¨ | ä¿ç•™è¯¦ç»†æ—¥å¿— |
| **ç”Ÿäº§ç¯å¢ƒ** | `æœ‰é™å¤§å°` | å‹ç¼©å­˜å‚¨ | å¿«é€Ÿæ¸…ç†ç­–ç•¥ |
| **å®¹å™¨ç¯å¢ƒ** | `unlimited` | æŒ‚è½½å· | å®¹å™¨ç‰¹å®šé…ç½® |

**ğŸ”¹ æœ€ä½³å®è·µå»ºè®®**
- **å¼€å‘é˜¶æ®µ**ï¼šå¯ç”¨æ‰€æœ‰è°ƒè¯•åŠŸèƒ½ï¼Œä¿ç•™å®Œæ•´è½¬å‚¨
- **æµ‹è¯•é˜¶æ®µ**ï¼šæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ŒéªŒè¯è½¬å‚¨åŠŸèƒ½
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¹³è¡¡è°ƒè¯•éœ€æ±‚å’Œç³»ç»Ÿæ€§èƒ½ï¼Œè®¾ç½®åˆç†é™åˆ¶
- **æ•…éšœæ’æŸ¥**ï¼šä¸´æ—¶å¯ç”¨è¯¦ç»†è½¬å‚¨ï¼Œé—®é¢˜è§£å†³åæ¢å¤

### 10.4 å¸¸è§é—®é¢˜è§£å†³


**â— è½¬å‚¨æœªç”Ÿæˆçš„æ’æŸ¥æ­¥éª¤**
```bash
# 1. æ£€æŸ¥ulimitè®¾ç½®
ulimit -c                # ç¡®ä¿ä¸ä¸º0

# 2. æ£€æŸ¥core_patterné…ç½®
cat /proc/sys/kernel/core_pattern

# 3. æ£€æŸ¥å­˜å‚¨ç›®å½•æƒé™
ls -ld /var/crash        # ç¡®ä¿æœ‰å†™æƒé™

# 4. æµ‹è¯•ä¿¡å·å¤„ç†
kill -QUIT $$           # æµ‹è¯•æ˜¯å¦èƒ½ç”Ÿæˆè½¬å‚¨
```

**âš ï¸ æ€§èƒ½å½±å“æ§åˆ¶**
- ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨
- è®¾ç½®åˆç†çš„æ–‡ä»¶å¤§å°é™åˆ¶
- å®šæœŸæ¸…ç†æ—§çš„è½¬å‚¨æ–‡ä»¶
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æ ¸å¿ƒè½¬å‚¨æ˜¯ç¨‹åºå´©æºƒè°ƒè¯•çš„é‡è¦å·¥å…·
- é…ç½®åˆ†ä¸ºå†…æ ¸çº§ã€ç³»ç»Ÿçº§ã€ç”¨æˆ·çº§ä¸‰ä¸ªå±‚æ¬¡
- ulimit -c æ˜¯æœ€åŸºç¡€çš„å¯ç”¨å¼€å…³
- core_pattern æ§åˆ¶æ–‡ä»¶å­˜å‚¨ä½ç½®å’Œå‘½å
- ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒçš„é…ç½®ç­–ç•¥
- å®šæœŸéªŒè¯å’Œæµ‹è¯•é…ç½®çš„æœ‰æ•ˆæ€§