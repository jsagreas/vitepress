---
title: 4ã€æ–‡ä»¶ç³»ç»Ÿå®¡è®¡ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [æ–‡ä»¶ç³»ç»Ÿå®¡è®¡åŸºç¡€æ¦‚å¿µ](#1-æ–‡ä»¶ç³»ç»Ÿå®¡è®¡åŸºç¡€æ¦‚å¿µ)
2. [æ–‡ä»¶è®¿é—®ç›‘æ§é…ç½®](#2-æ–‡ä»¶è®¿é—®ç›‘æ§é…ç½®)
3. [ç›®å½•é€’å½’ç›‘æ§è®¾ç½®](#3-ç›®å½•é€’å½’ç›‘æ§è®¾ç½®)
4. [æ–‡ä»¶æƒé™å˜æ›´å®¡è®¡](#4-æ–‡ä»¶æƒé™å˜æ›´å®¡è®¡)
5. [æ–‡ä»¶åˆ›å»ºåˆ é™¤å®¡è®¡](#5-æ–‡ä»¶åˆ›å»ºåˆ é™¤å®¡è®¡)
6. [æ•æ„Ÿæ–‡ä»¶ç›‘æ§ç­–ç•¥](#6-æ•æ„Ÿæ–‡ä»¶ç›‘æ§ç­–ç•¥)
7. [é…ç½®æ–‡ä»¶å˜æ›´ç›‘æ§](#7-é…ç½®æ–‡ä»¶å˜æ›´ç›‘æ§)
8. [æ–‡ä»¶å±æ€§ä¿®æ”¹å®¡è®¡](#8-æ–‡ä»¶å±æ€§ä¿®æ”¹å®¡è®¡)
9. [ç¬¦å·é“¾æ¥æ“ä½œå®¡è®¡](#9-ç¬¦å·é“¾æ¥æ“ä½œå®¡è®¡)
10. [å®æˆ˜åº”ç”¨ä¸æœ€ä½³å®è·µ](#10-å®æˆ˜åº”ç”¨ä¸æœ€ä½³å®è·µ)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æ–‡ä»¶ç³»ç»Ÿå®¡è®¡åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿå®¡è®¡


**ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ**
æ–‡ä»¶ç³»ç»Ÿå®¡è®¡å°±æ˜¯**ç›‘æ§å’Œè®°å½•**ç³»ç»Ÿä¸­æ–‡ä»¶çš„å„ç§æ“ä½œè¡Œä¸ºï¼Œæ¯”å¦‚è°è®¿é—®äº†å“ªä¸ªæ–‡ä»¶ã€ä»€ä¹ˆæ—¶å€™ä¿®æ”¹äº†æ–‡ä»¶æƒé™ã€åˆ é™¤äº†ä»€ä¹ˆæ–‡ä»¶ç­‰ç­‰ã€‚

```
ç®€å•ç†è§£ï¼š
å°±åƒç»™æ¯ä¸ªæ–‡ä»¶è£…ä¸Š"ç›‘æ§æ‘„åƒå¤´"
è®°å½•ä¸‹æ‰€æœ‰å¯¹æ–‡ä»¶çš„"ä¸€ä¸¾ä¸€åŠ¨"
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ–‡ä»¶å®¡è®¡**

| åº”ç”¨åœºæ™¯ | **å…·ä½“éœ€æ±‚** | **å®¡è®¡ä½œç”¨** |
|---------|-------------|-------------|
| ğŸ”’ **å®‰å…¨åˆè§„** | `æ³•è§„è¦æ±‚è®°å½•æ•æ„Ÿæ•°æ®è®¿é—®` | `æä¾›å®Œæ•´çš„è®¿é—®æ—¥å¿—` |
| ğŸ•µï¸ **å…¥ä¾µæ£€æµ‹** | `å‘ç°å¼‚å¸¸æ–‡ä»¶æ“ä½œ` | `åŠæ—¶å‘ç°æ”»å‡»è¡Œä¸º` |
| ğŸ“Š **æ•…éšœæ’æŸ¥** | `å®šä½é…ç½®æ–‡ä»¶è¢«è¯¯æ”¹` | `è¿½æº¯é—®é¢˜æ ¹æº` |
| ğŸ‘¥ **æƒé™ç®¡ç†** | `ç›‘æ§ç”¨æˆ·æ–‡ä»¶è®¿é—®` | `ç¡®ä¿æƒé™åˆè§„ä½¿ç”¨` |

### 1.2 auditdçš„å·¥ä½œåŸç†


**ğŸ”§ ç³»ç»Ÿæ¶æ„å›¾**
```
ç”¨æˆ·æ“ä½œæ–‡ä»¶
     â†“
ç³»ç»Ÿè°ƒç”¨å±‚ (openã€writeã€chmodç­‰)
     â†“
å†…æ ¸å®¡è®¡å­ç³»ç»Ÿ (audit framework)
     â†“
auditdå®ˆæŠ¤è¿›ç¨‹
     â†“
å®¡è®¡æ—¥å¿—æ–‡ä»¶ (/var/log/audit/audit.log)
```

**ğŸ“‹ æ ¸å¿ƒç»„ä»¶è¯´æ˜**
- **`auditd`**ï¼šå®¡è®¡å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£æ”¶é›†å’Œå†™å…¥æ—¥å¿—
- **`audit rules`**ï¼šå®¡è®¡è§„åˆ™ï¼Œå®šä¹‰ç›‘æ§ä»€ä¹ˆ
- **`ausearch`**ï¼šæœç´¢å®¡è®¡æ—¥å¿—çš„å·¥å…·
- **`aureport`**ï¼šç”Ÿæˆå®¡è®¡æŠ¥å‘Šçš„å·¥å…·

---

## 2. ğŸ“ æ–‡ä»¶è®¿é—®ç›‘æ§é…ç½®


### 2.1 åŸºæœ¬ç›‘æ§è§„åˆ™è¯­æ³•


**ğŸ”¸ æ ¸å¿ƒå‘½ä»¤æ ¼å¼**
```bash
auditctl -w æ–‡ä»¶è·¯å¾„ -p æƒé™ -k æ ‡ç­¾å
```

**ğŸ“ å‚æ•°è¯¦è§£**
```
-w (watch)ï¼šæŒ‡å®šè¦ç›‘æ§çš„æ–‡ä»¶æˆ–ç›®å½•
-p (permissions)ï¼šæŒ‡å®šç›‘æ§çš„æƒé™ç±»å‹
   â€¢ r = readï¼ˆè¯»å–ï¼‰
   â€¢ w = writeï¼ˆå†™å…¥ï¼‰  
   â€¢ x = executeï¼ˆæ‰§è¡Œï¼‰
   â€¢ a = attributeï¼ˆå±æ€§å˜æ›´ï¼‰
-k (key)ï¼šç»™è§„åˆ™èµ·ä¸ªæ ‡ç­¾åï¼Œæ–¹ä¾¿åç»­æŸ¥æ‰¾
```

### 2.2 æ–‡ä»¶è®¿é—®ç›‘æ§å®ä¾‹


**ğŸ“– ç›‘æ§é‡è¦æ–‡ä»¶çš„è¯»å–æ“ä½œ**
```bash
# ç›‘æ§ /etc/passwd æ–‡ä»¶çš„è¯»å–
auditctl -w /etc/passwd -p r -k passwd_read

# ç›‘æ§ SSH å¯†é’¥æ–‡ä»¶è®¿é—®
auditctl -w /root/.ssh/id_rsa -p ra -k ssh_key_access

# ç›‘æ§æ•°æ®åº“é…ç½®æ–‡ä»¶
auditctl -w /etc/mysql/my.cnf -p rwa -k db_config
```

**ğŸ” æŸ¥çœ‹ç›‘æ§æ•ˆæœ**
```bash
# æŸ¥çœ‹å½“å‰æ‰€æœ‰å®¡è®¡è§„åˆ™
auditctl -l

# æœç´¢ç›¸å…³å®¡è®¡è®°å½•
ausearch -k passwd_read

# å®æ—¶æŸ¥çœ‹å®¡è®¡æ—¥å¿—
tail -f /var/log/audit/audit.log
```

### 2.3 ä¸åŒæƒé™ç»„åˆçš„å«ä¹‰


**ğŸ¯ æƒé™ç»„åˆå®æˆ˜æŒ‡å—**

| æƒé™ç»„åˆ | **ç›‘æ§å†…å®¹** | **å…¸å‹åœºæ™¯** | **ç¤ºä¾‹å‘½ä»¤** |
|---------|-------------|-------------|-------------|
| **`-p r`** | `åªç›‘æ§è¯»å–` | `æ•æ„Ÿæ–‡ä»¶æŸ¥çœ‹` | `auditctl -w /etc/shadow -p r -k shadow_read` |
| **`-p w`** | `åªç›‘æ§å†™å…¥` | `æ—¥å¿—æ–‡ä»¶ä¿®æ”¹` | `auditctl -w /var/log/secure -p w -k log_modify` |
| **`-p x`** | `åªç›‘æ§æ‰§è¡Œ` | `å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œ` | `auditctl -w /usr/bin/sudo -p x -k sudo_exec` |
| **`-p rw`** | `ç›‘æ§è¯»å†™` | `é…ç½®æ–‡ä»¶æ“ä½œ` | `auditctl -w /etc/hosts -p rw -k hosts_change` |
| **`-p rwa`** | `ç›‘æ§æ‰€æœ‰æ“ä½œ` | `å…¨é¢ç›‘æ§` | `auditctl -w /home/admin -p rwa -k admin_files` |

---

## 3. ğŸ“‚ ç›®å½•é€’å½’ç›‘æ§è®¾ç½®


### 3.1 ç›®å½•ç›‘æ§åŸºç¡€


**ğŸ”¸ ç›®å½•ç›‘æ§ç‰¹ç‚¹**
ç›®å½•ç›‘æ§é»˜è®¤**ä¸æ˜¯é€’å½’çš„**ï¼Œåªç›‘æ§ç›®å½•æœ¬èº«çš„æ“ä½œï¼ˆå¦‚åˆ›å»ºã€åˆ é™¤å­æ–‡ä»¶ï¼‰ï¼Œä¸ä¼šç›‘æ§å­ç›®å½•å†…éƒ¨çš„æ–‡ä»¶æ“ä½œã€‚

```
ä¸¾ä¸ªä¾‹å­ï¼š
ç›‘æ§ /home/user/
åªèƒ½çœ‹åˆ°ï¼š
âœ… /home/user/ä¸‹ç›´æ¥åˆ›å»ºæ–‡ä»¶
âŒ /home/user/documents/file.txt çš„æ“ä½œï¼ˆå­ç›®å½•å†…ï¼‰
```

### 3.2 å®ç°çœŸæ­£çš„é€’å½’ç›‘æ§


**ğŸ› ï¸ æ–¹æ³•ä¸€ï¼šè„šæœ¬æ‰¹é‡æ·»åŠ è§„åˆ™**
```bash
#!/bin/bash
# é€’å½’ç›‘æ§ /etc ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•

find /etc -type f | while read file; do
    auditctl -w "$file" -p rwa -k etc_files
done

find /etc -type d | while read dir; do
    auditctl -w "$dir" -p rwa -k etc_dirs
done
```

**ğŸ› ï¸ æ–¹æ³•äºŒï¼šé€šè¿‡ auditd.rules é…ç½®**
```bash
# ç¼–è¾‘ /etc/audit/rules.d/audit.rules
vi /etc/audit/rules.d/file-monitor.rules

# æ·»åŠ ä»¥ä¸‹å†…å®¹
-w /home/users/ -p rwa -k user_home
-w /var/www/ -p rwa -k web_files
-w /opt/app/ -p rwa -k app_files

# é‡å¯ auditd æœåŠ¡
systemctl restart auditd
```

### 3.3 ç›‘æ§ç›®å½•çš„æœ€ä½³å®è·µ


**ğŸ“Š ç›‘æ§ç­–ç•¥å¯¹æ¯”**

| ç›‘æ§èŒƒå›´ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **ğŸ¯ ç²¾ç¡®æ–‡ä»¶** | `æ€§èƒ½å¥½ï¼Œæ—¥å¿—å°‘` | `éœ€è¦é€ä¸ªæŒ‡å®š` | `å…³é”®é…ç½®æ–‡ä»¶` |
| **ğŸ“ å•å±‚ç›®å½•** | `é…ç½®ç®€å•` | `æ— æ³•ç›‘æ§å­ç›®å½•` | `æ—¥å¿—ç›®å½•` |
| **ğŸŒ³ é€’å½’ç›‘æ§** | `å…¨é¢è¦†ç›–` | `æ—¥å¿—é‡å¤§ï¼Œæ€§èƒ½å½±å“` | `é‡è¦æ•°æ®ç›®å½•` |

**ğŸ’¡ å®ç”¨ç›‘æ§ç¤ºä¾‹**
```bash
# ç›‘æ§ç”¨æˆ·ä¸»ç›®å½•ï¼ˆé€‰æ‹©æ€§ï¼‰
auditctl -w /home -p wa -k home_changes

# ç›‘æ§ç³»ç»Ÿé…ç½®ç›®å½•
auditctl -w /etc -p wa -k system_config

# ç›‘æ§ Web æœåŠ¡ç›®å½•
auditctl -w /var/www/html -p rwa -k web_content

# ç›‘æ§åº”ç”¨æ—¥å¿—ç›®å½•
auditctl -w /var/log/application -p w -k app_logs
```

---

## 4. ğŸ” æ–‡ä»¶æƒé™å˜æ›´å®¡è®¡


### 4.1 æƒé™å˜æ›´ç›‘æ§åŸç†


**ğŸ¯ ä»€ä¹ˆæ˜¯æƒé™å˜æ›´**
æƒé™å˜æ›´å°±æ˜¯ä¿®æ”¹æ–‡ä»¶çš„**è®¿é—®æƒé™**ï¼ˆè¯»ã€å†™ã€æ‰§è¡Œï¼‰æˆ–**æ‰€æœ‰è€…ä¿¡æ¯**ï¼ˆç”¨æˆ·ã€ç»„ï¼‰ã€‚

```
å¸¸è§æƒé™å˜æ›´æ“ä½œï¼š
chmod 755 file.txt     â† ä¿®æ”¹æ–‡ä»¶æƒé™
chown user:group file  â† ä¿®æ”¹æ‰€æœ‰è€…
chgrp newgroup file    â† ä¿®æ”¹æ‰€å±ç»„
```

### 4.2 ç›‘æ§æƒé™å˜æ›´çš„é…ç½®


**ğŸ”§ åŸºæœ¬ç›‘æ§è®¾ç½®**
```bash
# ç›‘æ§é‡è¦æ–‡ä»¶çš„å±æ€§å˜æ›´
auditctl -w /etc/passwd -p a -k passwd_attr_change
auditctl -w /etc/shadow -p a -k shadow_attr_change
auditctl -w /etc/sudoers -p a -k sudo_attr_change

# ç›‘æ§ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶æƒé™å˜æ›´
auditctl -w /usr/bin -p a -k binary_attr_change
auditctl -w /usr/sbin -p a -k sbin_attr_change
```

**ğŸ“‹ å®é™…æ¡ˆä¾‹æ¼”ç¤º**
```bash
# 1. å…ˆè®¾ç½®ç›‘æ§è§„åˆ™
auditctl -w /tmp/test.txt -p a -k test_attr

# 2. è¿›è¡Œæƒé™å˜æ›´æ“ä½œ
echo "test content" > /tmp/test.txt
chmod 777 /tmp/test.txt
chown nobody:nobody /tmp/test.txt

# 3. æŸ¥çœ‹å®¡è®¡è®°å½•
ausearch -k test_attr
```

### 4.3 å®¡è®¡æ—¥å¿—è§£è¯»


**ğŸ“– å…¸å‹æƒé™å˜æ›´æ—¥å¿—**
```
type=PATH msg=audit(1642387200.123:456): item=0 name="/tmp/test.txt" 
inode=12345 dev=08:01 mode=0100644 ouid=0 ogid=0 rdev=00:00 
obj=unconfined_u:object_r:tmp_t:s0 objtype=NORMAL

type=SYSCALL msg=audit(1642387200.123:456): arch=c000003e syscall=268 
success=yes exit=0 a0=ffffff9c a1=7fff12345678 a2=1ff a3=0 
items=1 ppid=1234 pid=5678 auid=0 uid=0 gid=0 euid=0 suid=0 
fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=1 comm="chmod" 
exe="/usr/bin/chmod" key="test_attr"
```

**ğŸ” å…³é”®å­—æ®µè§£è¯»**
- **`syscall=268`**ï¼šç³»ç»Ÿè°ƒç”¨å·ï¼Œ268 å¯¹åº” fchmodat
- **`comm="chmod"`**ï¼šæ‰§è¡Œçš„å‘½ä»¤
- **`mode=0100644`**ï¼šæ–‡ä»¶æƒé™ï¼ˆå…«è¿›åˆ¶ï¼‰
- **`uid=0`**ï¼šæ‰§è¡Œæ“ä½œçš„ç”¨æˆ· ID
- **`key="test_attr"`**ï¼šæˆ‘ä»¬è®¾ç½®çš„æ ‡ç­¾

---

## 5. ğŸ“ æ–‡ä»¶åˆ›å»ºåˆ é™¤å®¡è®¡


### 5.1 æ–‡ä»¶åˆ›å»ºåˆ é™¤ç›‘æ§ç­–ç•¥


**ğŸ¯ ç›‘æ§é‡ç‚¹**
```
æ–‡ä»¶åˆ›å»ºï¼šç›‘æ§åœ¨æ•æ„Ÿç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶
æ–‡ä»¶åˆ é™¤ï¼šé˜²æ­¢é‡è¦æ–‡ä»¶è¢«è¯¯åˆ æˆ–æ¶æ„åˆ é™¤
æ–‡ä»¶é‡å‘½åï¼šmv æ“ä½œä¹Ÿéœ€è¦å…³æ³¨
```

### 5.2 åˆ›å»ºåˆ é™¤ç›‘æ§é…ç½®


**ğŸ”§ åŸºç¡€ç›‘æ§è®¾ç½®**
```bash
# ç›‘æ§é‡è¦ç›®å½•çš„æ–‡ä»¶åˆ›å»ºåˆ é™¤
auditctl -w /etc -p wa -k etc_file_changes
auditctl -w /home -p wa -k home_file_changes
auditctl -w /var/log -p wa -k log_file_changes

# ç›‘æ§ä¸´æ—¶ç›®å½•ï¼ˆæ³¨æ„ï¼šæ—¥å¿—é‡å¯èƒ½å¾ˆå¤§ï¼‰
auditctl -w /tmp -p wa -k tmp_file_ops

# ç›‘æ§ç³»ç»Ÿç›®å½•å˜æ›´
auditctl -w /usr/bin -p wa -k system_binary_changes
```

**ğŸ› ï¸ é«˜çº§ç›‘æ§ï¼šç³»ç»Ÿè°ƒç”¨çº§åˆ«**
```bash
# ç›‘æ§æ‰€æœ‰æ–‡ä»¶åˆ›å»ºæ“ä½œï¼ˆcreatã€open with O_CREATï¼‰
auditctl -a always,exit -F arch=b64 -S creat,open,openat -F success=1 -k file_create

# ç›‘æ§æ‰€æœ‰æ–‡ä»¶åˆ é™¤æ“ä½œï¼ˆunlinkã€rmdirï¼‰
auditctl -a always,exit -F arch=b64 -S unlink,unlinkat,rmdir -F success=1 -k file_delete

# ç›‘æ§æ–‡ä»¶é‡å‘½åæ“ä½œ
auditctl -a always,exit -F arch=b64 -S rename,renameat -F success=1 -k file_rename
```

### 5.3 å®é™…åº”ç”¨ç¤ºä¾‹


**ğŸ“‹ Web æœåŠ¡å™¨æ–‡ä»¶ç›‘æ§**
```bash
# ç›‘æ§ç½‘ç«™æ–‡ä»¶å˜æ›´
auditctl -w /var/www/html -p wa -k website_changes

# ç›‘æ§ä¸Šä¼ ç›®å½•
auditctl -w /var/www/uploads -p wa -k upload_changes

# ç›‘æ§ nginx é…ç½®
auditctl -w /etc/nginx -p wa -k nginx_config_changes
```

**ğŸ” æŸ¥çœ‹åˆ›å»ºåˆ é™¤è®°å½•**
```bash
# æŸ¥çœ‹æ–‡ä»¶åˆ›å»ºè®°å½•
ausearch -k file_create -ts recent

# æŸ¥çœ‹æ–‡ä»¶åˆ é™¤è®°å½•  
ausearch -k file_delete -ts today

# æŸ¥çœ‹ç‰¹å®šç›®å½•çš„å˜æ›´
ausearch -k website_changes -ts yesterday
```

---

## 6. ğŸ›¡ï¸ æ•æ„Ÿæ–‡ä»¶ç›‘æ§ç­–ç•¥


### 6.1 æ•æ„Ÿæ–‡ä»¶è¯†åˆ«


**ğŸ”’ ç³»ç»Ÿçº§æ•æ„Ÿæ–‡ä»¶**
```
èº«ä»½è®¤è¯æ–‡ä»¶ï¼š
â”œâ”€â”€ /etc/passwd          ç”¨æˆ·è´¦æˆ·ä¿¡æ¯
â”œâ”€â”€ /etc/shadow          ç”¨æˆ·å¯†ç å“ˆå¸Œ
â”œâ”€â”€ /etc/group           ç”¨æˆ·ç»„ä¿¡æ¯
â””â”€â”€ /etc/gshadow         ç”¨æˆ·ç»„å¯†ç 

æƒé™æ§åˆ¶æ–‡ä»¶ï¼š
â”œâ”€â”€ /etc/sudoers         sudo æƒé™é…ç½®
â”œâ”€â”€ /etc/sudoers.d/*     sudo æƒé™æ‰©å±•
â””â”€â”€ /etc/security/*      å®‰å…¨ç­–ç•¥é…ç½®

SSH ç›¸å…³æ–‡ä»¶ï¼š
â”œâ”€â”€ /etc/ssh/sshd_config SSH æœåŠ¡é…ç½®
â”œâ”€â”€ /root/.ssh/*         root ç”¨æˆ·å¯†é’¥
â””â”€â”€ /home/*/.ssh/*       ç”¨æˆ· SSH å¯†é’¥
```

### 6.2 æ•æ„Ÿæ–‡ä»¶ç›‘æ§é…ç½®


**ğŸ”§ å®Œæ•´ç›‘æ§è§„åˆ™**
```bash
#!/bin/bash
# æ•æ„Ÿæ–‡ä»¶ç›‘æ§è„šæœ¬

# ç³»ç»Ÿè®¤è¯æ–‡ä»¶
auditctl -w /etc/passwd -p rwa -k auth_files
auditctl -w /etc/shadow -p rwa -k auth_files  
auditctl -w /etc/group -p rwa -k auth_files
auditctl -w /etc/gshadow -p rwa -k auth_files

# sudo é…ç½®æ–‡ä»¶
auditctl -w /etc/sudoers -p rwa -k sudo_config
auditctl -w /etc/sudoers.d/ -p rwa -k sudo_config

# SSH é…ç½®æ–‡ä»¶
auditctl -w /etc/ssh/sshd_config -p rwa -k ssh_config
auditctl -w /root/.ssh -p rwa -k root_ssh
auditctl -w /home/.ssh -p rwa -k user_ssh

# ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶
auditctl -w /etc/rc.local -p rwa -k startup_files
auditctl -w /etc/systemd/system -p rwa -k systemd_config

# ç½‘ç»œé…ç½®æ–‡ä»¶
auditctl -w /etc/hosts -p rwa -k network_config
auditctl -w /etc/resolv.conf -p rwa -k network_config
```

### 6.3 åº”ç”¨çº§æ•æ„Ÿæ–‡ä»¶


**ğŸ—„ï¸ æ•°æ®åº“é…ç½®æ–‡ä»¶**
```bash
# MySQL é…ç½®ç›‘æ§
auditctl -w /etc/mysql/my.cnf -p rwa -k mysql_config
auditctl -w /var/lib/mysql -p wa -k mysql_data

# PostgreSQL é…ç½®ç›‘æ§
auditctl -w /etc/postgresql -p rwa -k postgres_config
auditctl -w /var/lib/postgresql -p wa -k postgres_data
```

**ğŸŒ Web æœåŠ¡é…ç½®æ–‡ä»¶**
```bash
# Apache é…ç½®ç›‘æ§
auditctl -w /etc/apache2 -p rwa -k apache_config
auditctl -w /etc/httpd -p rwa -k httpd_config

# Nginx é…ç½®ç›‘æ§
auditctl -w /etc/nginx -p rwa -k nginx_config

# SSL è¯ä¹¦ç›‘æ§
auditctl -w /etc/ssl/certs -p rwa -k ssl_certs
auditctl -w /etc/pki/tls -p rwa -k tls_certs
```

---

## 7. âš™ï¸ é…ç½®æ–‡ä»¶å˜æ›´ç›‘æ§


### 7.1 ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›‘æ§


**ğŸ”§ æ ¸å¿ƒç³»ç»Ÿé…ç½®**
```bash
# ç³»ç»ŸæœåŠ¡é…ç½®
auditctl -w /etc/systemd/system -p wa -k systemd_changes
auditctl -w /etc/init.d -p wa -k init_changes

# ç½‘ç»œé…ç½®ç›‘æ§
auditctl -w /etc/network/interfaces -p rwa -k network_interfaces
auditctl -w /etc/netplan -p rwa -k netplan_config

# é˜²ç«å¢™é…ç½®ç›‘æ§
auditctl -w /etc/iptables -p rwa -k firewall_config
auditctl -w /etc/ufw -p rwa -k ufw_config

# æ—¶é—´åŒæ­¥é…ç½®
auditctl -w /etc/ntp.conf -p rwa -k ntp_config
auditctl -w /etc/chrony -p rwa -k chrony_config
```

### 7.2 åº”ç”¨é…ç½®æ–‡ä»¶ç›‘æ§


**ğŸ“Š ç›‘æ§é…ç½®æ–‡ä»¶çš„å±‚æ¬¡ç»“æ„**
```
åº”ç”¨é…ç½®ç›‘æ§ç­–ç•¥ï¼š
â”œâ”€â”€ ä¸»é…ç½®æ–‡ä»¶ (å¿…ç›‘æ§)
â”‚   â”œâ”€â”€ æ•°æ®åº“è¿æ¥é…ç½®
â”‚   â”œâ”€â”€ æ—¥å¿—è¾“å‡ºé…ç½®  
â”‚   â””â”€â”€ å®‰å…¨è®¤è¯é…ç½®
â”œâ”€â”€ å­é…ç½®æ–‡ä»¶ (é€‰æ‹©ç›‘æ§)
â”‚   â”œâ”€â”€ æ¨¡å—ç‰¹å®šé…ç½®
â”‚   â””â”€â”€ ç¯å¢ƒå˜é‡é…ç½®
â””â”€â”€ åŠ¨æ€é…ç½®æ–‡ä»¶ (è°¨æ…ç›‘æ§)
    â”œâ”€â”€ ç¼“å­˜é…ç½®
    â””â”€â”€ ä¸´æ—¶é…ç½®
```

**ğŸ› ï¸ å®é™…é…ç½®ç¤ºä¾‹**
```bash
# Java åº”ç”¨é…ç½®ç›‘æ§
auditctl -w /opt/app/config/application.properties -p rwa -k java_app_config
auditctl -w /opt/app/config/database.yml -p rwa -k java_db_config

# Docker é…ç½®ç›‘æ§
auditctl -w /etc/docker/daemon.json -p rwa -k docker_config
auditctl -w /var/lib/docker/containers -p wa -k docker_containers

# ç›‘æ§é…ç½®ç®¡ç†å·¥å…·
auditctl -w /etc/ansible -p rwa -k ansible_config
auditctl -w /etc/puppet -p rwa -k puppet_config
```

### 7.3 é…ç½®å˜æ›´å‘Šè­¦æœºåˆ¶


**ğŸš¨ å®æ—¶å‘Šè­¦è„šæœ¬**
```bash
#!/bin/bash
# é…ç½®æ–‡ä»¶å˜æ›´å‘Šè­¦è„šæœ¬

# å®æ—¶ç›‘æ§å®¡è®¡æ—¥å¿—
tail -f /var/log/audit/audit.log | grep -E "(systemd_changes|network_config|firewall_config)" | while read line; do
    # æå–å…³é”®ä¿¡æ¯
    timestamp=$(echo "$line" | grep -oP 'msg=audit\(\K[^)]+')
    key=$(echo "$line" | grep -oP 'key="\K[^"]+')
    file=$(echo "$line" | grep -oP 'name="\K[^"]+')
    
    # å‘é€å‘Šè­¦
    if [[ ! -z "$file" ]]; then
        echo "âš ï¸ é…ç½®æ–‡ä»¶å˜æ›´å‘Šè­¦"
        echo "æ—¶é—´: $(date -d @${timestamp%.*})"
        echo "ç±»å‹: $key"
        echo "æ–‡ä»¶: $file"
        echo "---"
        
        # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é‚®ä»¶æˆ–çŸ­ä¿¡å‘Šè­¦
        # mail -s "é…ç½®æ–‡ä»¶å˜æ›´" admin@company.com
    fi
done
```

---

## 8. ğŸ“‹ æ–‡ä»¶å±æ€§ä¿®æ”¹å®¡è®¡


### 8.1 æ–‡ä»¶å±æ€§ç±»å‹è¯¦è§£


**ğŸ” Linux æ–‡ä»¶å±æ€§åˆ†ç±»**
```
åŸºæœ¬å±æ€§ï¼š
â”œâ”€â”€ æƒé™ä½ (rwxrwxrwx)
â”œâ”€â”€ æ‰€æœ‰è€… (user:group)  
â”œâ”€â”€ æ—¶é—´æˆ³ (atime,mtime,ctime)
â””â”€â”€ æ–‡ä»¶å¤§å° (size)

æ‰©å±•å±æ€§ï¼š
â”œâ”€â”€ SELinux ä¸Šä¸‹æ–‡
â”œâ”€â”€ æ‰©å±•è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL)
â”œâ”€â”€ æ–‡ä»¶ç³»ç»Ÿç‰¹å®šå±æ€§
â””â”€â”€ ç”¨æˆ·è‡ªå®šä¹‰å±æ€§ (xattr)
```

### 8.2 å±æ€§ä¿®æ”¹ç›‘æ§é…ç½®


**ğŸ”§ å…¨é¢å±æ€§ç›‘æ§**
```bash
# ç›‘æ§å…³é”®ç³»ç»Ÿæ–‡ä»¶çš„å±æ€§å˜æ›´
auditctl -w /bin -p a -k system_binary_attr
auditctl -w /sbin -p a -k system_sbin_attr
auditctl -w /usr/bin -p a -k user_binary_attr

# ç›‘æ§é‡è¦æ•°æ®ç›®å½•å±æ€§
auditctl -w /home -p a -k home_attr_changes
auditctl -w /var/log -p a -k log_attr_changes

# ç›‘æ§ç‰¹å®šæ–‡ä»¶çš„æ‰€æœ‰å±æ€§å˜æ›´
auditctl -w /etc/passwd -p a -k passwd_attr
auditctl -w /etc/shadow -p a -k shadow_attr
```

**ğŸ› ï¸ ç³»ç»Ÿè°ƒç”¨çº§å±æ€§ç›‘æ§**
```bash
# ç›‘æ§ chmod ç³»ç»Ÿè°ƒç”¨
auditctl -a always,exit -F arch=b64 -S chmod,fchmod,fchmodat -k chmod_calls

# ç›‘æ§ chown ç³»ç»Ÿè°ƒç”¨  
auditctl -a always,exit -F arch=b64 -S chown,fchown,lchown,fchownat -k chown_calls

# ç›‘æ§æ‰©å±•å±æ€§æ“ä½œ
auditctl -a always,exit -F arch=b64 -S setxattr,lsetxattr,fsetxattr -k xattr_set
auditctl -a always,exit -F arch=b64 -S removexattr,lremovexattr,fremovexattr -k xattr_remove
```

### 8.3 å±æ€§å˜æ›´åˆ†æ


**ğŸ“Š å…¸å‹å±æ€§å˜æ›´åœºæ™¯**

| æ“ä½œç±»å‹ | **ç›‘æ§é‡ç‚¹** | **é£é™©çº§åˆ«** | **å…¸å‹å‘½ä»¤** |
|---------|-------------|-------------|-------------|
| **ğŸ” æƒé™æå‡** | `chmod +s, chmod 777` | `ğŸ”´ é«˜é£é™©` | `chmod 4755 /usr/bin/passwd` |
| **ğŸ‘¤ æ‰€æœ‰è€…å˜æ›´** | `chown root:root` | `ğŸŸ¡ ä¸­é£é™©` | `chown root sensitive_file` |
| **ğŸ• æ—¶é—´æˆ³ä¿®æ”¹** | `touch -t` | `ğŸŸ¢ ä½é£é™©` | `touch -t 202201010000 file` |
| **ğŸ·ï¸ æ‰©å±•å±æ€§** | `setfattr, setcap` | `ğŸŸ¡ ä¸­é£é™©` | `setcap cap_net_raw+ep /bin/ping` |

**ğŸ” å±æ€§å˜æ›´æ—¥å¿—åˆ†æç¤ºä¾‹**
```bash
# æŸ¥çœ‹æƒé™å˜æ›´è®°å½•
ausearch -k chmod_calls -ts recent | aureport -f

# æŸ¥çœ‹æ‰€æœ‰è€…å˜æ›´è®°å½•
ausearch -k chown_calls -ts today

# ç”Ÿæˆå±æ€§å˜æ›´æŠ¥å‘Š
aureport -m -ts yesterday
```

---

## 9. ğŸ”— ç¬¦å·é“¾æ¥æ“ä½œå®¡è®¡


### 9.1 ç¬¦å·é“¾æ¥å®‰å…¨é£é™©


**âš ï¸ ç¬¦å·é“¾æ¥çš„å®‰å…¨éšæ‚£**
```
è·¯å¾„éå†æ”»å‡»ï¼š
/var/www/html/uploads/file.txt -> /etc/passwd

æƒé™æå‡æ”»å‡»ï¼š  
/tmp/exploit -> /usr/bin/sudo

æ•°æ®æ³„éœ²é£é™©ï¼š
/public/docs/readme.txt -> /root/secret.key
```

**ğŸ¯ ç›‘æ§ç¬¦å·é“¾æ¥çš„é‡è¦æ€§**
- **é˜²æ­¢è·¯å¾„éå†**ï¼šé¿å…é€šè¿‡ç¬¦å·é“¾æ¥è®¿é—®æ•æ„Ÿæ–‡ä»¶
- **æ£€æµ‹æƒé™ç»•è¿‡**ï¼šå‘ç°åˆ©ç”¨ç¬¦å·é“¾æ¥æå‡æƒé™çš„è¡Œä¸º
- **è¿½è¸ªæ–‡ä»¶æ“ä½œ**ï¼šäº†è§£æ–‡ä»¶çš„çœŸå®è®¿é—®è·¯å¾„

### 9.2 ç¬¦å·é“¾æ¥ç›‘æ§é…ç½®


**ğŸ”§ åŸºç¡€ç¬¦å·é“¾æ¥ç›‘æ§**
```bash
# ç›‘æ§ç¬¦å·é“¾æ¥åˆ›å»º
auditctl -a always,exit -F arch=b64 -S symlink,symlinkat -k symlink_create

# ç›‘æ§ç¬¦å·é“¾æ¥è¯»å–
auditctl -a always,exit -F arch=b64 -S readlink,readlinkat -k symlink_read

# ç›‘æ§é‡è¦ç›®å½•çš„ç¬¦å·é“¾æ¥æ“ä½œ
auditctl -w /etc -p wa -k etc_symlinks
auditctl -w /usr/bin -p wa -k bin_symlinks
auditctl -w /var/www -p wa -k web_symlinks
```

**ğŸ› ï¸ é«˜çº§ç¬¦å·é“¾æ¥ç›‘æ§**
```bash
# ç›‘æ§ç‰¹å®šç”¨æˆ·çš„ç¬¦å·é“¾æ¥æ“ä½œ
auditctl -a always,exit -F arch=b64 -S symlink -F uid=1000 -k user_symlinks

# ç›‘æ§ä»ç‰¹å®šç›®å½•åˆ›å»ºçš„ç¬¦å·é“¾æ¥
auditctl -a always,exit -F arch=b64 -S symlink -F dir=/tmp -k tmp_symlinks

# ç›‘æ§æŒ‡å‘æ•æ„Ÿæ–‡ä»¶çš„ç¬¦å·é“¾æ¥
auditctl -w /etc/passwd -p rwa -k passwd_access
auditctl -w /etc/shadow -p rwa -k shadow_access
```

### 9.3 ç¬¦å·é“¾æ¥å®¡è®¡å®ä¾‹


**ğŸ“‹ å®é™…ç›‘æ§åœºæ™¯**
```bash
# åœºæ™¯1ï¼šWeb åº”ç”¨ä¸Šä¼ ç›®å½•ç›‘æ§
auditctl -w /var/www/uploads -p wa -k upload_symlinks

# åœºæ™¯2ï¼šç”¨æˆ·ä¸»ç›®å½•ç¬¦å·é“¾æ¥ç›‘æ§
find /home -maxdepth 2 -name ".ssh" | while read dir; do
    auditctl -w "$dir" -p wa -k user_ssh_symlinks
done

# åœºæ™¯3ï¼šç³»ç»Ÿé…ç½®ç›®å½•ç›‘æ§
auditctl -w /etc/cron.d -p wa -k cron_symlinks
auditctl -w /etc/systemd/system -p wa -k systemd_symlinks
```

**ğŸ” ç¬¦å·é“¾æ¥æ—¥å¿—åˆ†æ**
```bash
# æŸ¥çœ‹ç¬¦å·é“¾æ¥åˆ›å»ºè®°å½•
ausearch -k symlink_create -ts recent

# æŸ¥çœ‹ç‰¹å®šç›®å½•çš„ç¬¦å·é“¾æ¥æ“ä½œ
ausearch -k web_symlinks -ts today | grep symlink

# åˆ†æç¬¦å·é“¾æ¥ç›¸å…³çš„æ–‡ä»¶è®¿é—®
ausearch -f /etc/passwd | grep -E "(symlink|readlink)"
```

---

## 10. ğŸš€ å®æˆ˜åº”ç”¨ä¸æœ€ä½³å®è·µ


### 10.1 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç­–ç•¥


**ğŸ“Š åˆ†å±‚ç›‘æ§ç­–ç•¥**
```
ç›‘æ§çº§åˆ«åˆ’åˆ†ï¼š
â”œâ”€â”€ ğŸ”´ å…³é”®çº§ (å¿…é¡»ç›‘æ§)
â”‚   â”œâ”€â”€ ç³»ç»Ÿè®¤è¯æ–‡ä»¶
â”‚   â”œâ”€â”€ sudo é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ SSH é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸŸ¡ é‡è¦çº§ (å»ºè®®ç›‘æ§)  
â”‚   â”œâ”€â”€ åº”ç”¨é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ Web æœåŠ¡é…ç½®
â””â”€â”€ ğŸŸ¢ ä¸€èˆ¬çº§ (é€‰æ‹©ç›‘æ§)
    â”œâ”€â”€ æ—¥å¿—æ–‡ä»¶å˜æ›´
    â”œâ”€â”€ ä¸´æ—¶æ–‡ä»¶æ“ä½œ
    â””â”€â”€ ç”¨æˆ·æ–‡ä»¶è®¿é—®
```

**ğŸ› ï¸ ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿**
```bash
#!/bin/bash
# ç”Ÿäº§ç¯å¢ƒæ–‡ä»¶å®¡è®¡é…ç½®

# 1. å…³é”®ç³»ç»Ÿæ–‡ä»¶ç›‘æ§
auditctl -w /etc/passwd -p rwa -k critical_auth
auditctl -w /etc/shadow -p rwa -k critical_auth
auditctl -w /etc/sudoers -p rwa -k critical_sudo

# 2. åº”ç”¨é…ç½®æ–‡ä»¶ç›‘æ§
auditctl -w /etc/nginx -p rwa -k app_nginx
auditctl -w /etc/mysql -p rwa -k app_mysql
auditctl -w /opt/app/config -p rwa -k app_config

# 3. æ•°æ®ç›®å½•ç›‘æ§
auditctl -w /var/www/html -p wa -k web_content
auditctl -w /var/lib/mysql -p wa -k mysql_data

# 4. æ—¥å¿—ç›®å½•ç›‘æ§
auditctl -w /var/log/secure -p w -k security_logs
auditctl -w /var/log/auth.log -p w -k auth_logs

echo "âœ… ç”Ÿäº§ç¯å¢ƒå®¡è®¡è§„åˆ™é…ç½®å®Œæˆ"
```

### 10.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**

| ä¼˜åŒ–æ–¹å‘ | **å…·ä½“æªæ–½** | **æ•ˆæœ** |
|---------|-------------|---------|
| **ğŸ¯ ç²¾ç¡®ç›‘æ§** | `åªç›‘æ§å¿…è¦çš„æ–‡ä»¶å’Œæ“ä½œ` | `å‡å°‘ 50-70% æ—¥å¿—é‡` |
| **ğŸ“Š åˆç†åˆ†çº§** | `æ ¹æ®é‡è¦æ€§è®¾ç½®ä¸åŒç›‘æ§çº§åˆ«` | `å¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½` |
| **ğŸ• å®šæœŸæ¸…ç†** | `è‡ªåŠ¨è½®è½¬å’Œæ¸…ç†å®¡è®¡æ—¥å¿—` | `é¿å…ç£ç›˜ç©ºé—´ä¸è¶³` |
| **ğŸ”§ ç³»ç»Ÿè°ƒä¼˜** | `è°ƒæ•´ auditd ç¼“å†²åŒºå¤§å°` | `æé«˜æ—¥å¿—å†™å…¥æ•ˆç‡` |

**ğŸ”§ auditd æ€§èƒ½è°ƒä¼˜**
```bash
# ç¼–è¾‘ auditd é…ç½®æ–‡ä»¶
vi /etc/audit/auditd.conf

# å…³é”®æ€§èƒ½å‚æ•°
log_file = /var/log/audit/audit.log
log_format = RAW
log_group = root
priority_boost = 4
flush = INCREMENTAL_ASYNC
freq = 50
num_logs = 5
disp_qos = lossy
dispatcher = /sbin/audispd
name_format = NONE
max_log_file = 50
max_log_file_action = ROTATE
space_left = 75
space_left_action = SYSLOG
admin_space_left = 50
admin_space_left_action = SUSPEND
disk_full_action = SUSPEND
disk_error_action = SUSPEND
```

### 10.3 æ—¥å¿—åˆ†æè‡ªåŠ¨åŒ–


**ğŸ¤– è‡ªåŠ¨åŒ–åˆ†æè„šæœ¬**
```bash
#!/bin/bash
# æ–‡ä»¶å®¡è®¡æ—¥å¿—è‡ªåŠ¨åˆ†æè„šæœ¬

# è®¾ç½®æ—¶é—´èŒƒå›´
START_TIME=$(date -d "1 hour ago" "+%Y-%m-%d %H:%M:%S")
END_TIME=$(date "+%Y-%m-%d %H:%M:%S")

echo "ğŸ” æ–‡ä»¶å®¡è®¡åˆ†ææŠ¥å‘Š - $(date)"
echo "åˆ†ææ—¶é—´èŒƒå›´: $START_TIME åˆ° $END_TIME"
echo "================================================="

# 1. æ•æ„Ÿæ–‡ä»¶è®¿é—®ç»Ÿè®¡
echo "ğŸ“‹ æ•æ„Ÿæ–‡ä»¶è®¿é—®ç»Ÿè®¡:"
ausearch -ts "$START_TIME" -te "$END_TIME" -k critical_auth | \
aureport -f | tail -n +4 | head -n -2

# 2. æƒé™å˜æ›´æ“ä½œ
echo -e "\nğŸ” æƒé™å˜æ›´æ“ä½œ:"
ausearch -ts "$START_TIME" -te "$END_TIME" -k chmod_calls | \
aureport -m | tail -n +4 | head -n -2

# 3. æ–‡ä»¶åˆ›å»ºåˆ é™¤ç»Ÿè®¡
echo -e "\nğŸ“ æ–‡ä»¶åˆ›å»ºåˆ é™¤ç»Ÿè®¡:"
ausearch -ts "$START_TIME" -te "$END_TIME" -k file_create,file_delete | \
aureport -f | tail -n +4 | head -n -2

# 4. å¼‚å¸¸æ“ä½œæ£€æµ‹
echo -e "\nâš ï¸ å¼‚å¸¸æ“ä½œæ£€æµ‹:"
ausearch -ts "$START_TIME" -te "$END_TIME" | grep -E "(ANOM|ANOMALY)" | wc -l
echo "æ£€æµ‹åˆ° $(ausearch -ts "$START_TIME" -te "$END_TIME" | grep -E "(ANOM|ANOMALY)" | wc -l) ä¸ªå¼‚å¸¸äº‹ä»¶"

# 5. ç”Ÿæˆç®€è¦æŠ¥å‘Š
echo -e "\nğŸ“Š æ€»ä½“ç»Ÿè®¡:"
echo "æ€»å®¡è®¡äº‹ä»¶æ•°: $(ausearch -ts "$START_TIME" -te "$END_TIME" | grep -c "type=")"
echo "æ–‡ä»¶æ“ä½œäº‹ä»¶: $(ausearch -ts "$START_TIME" -te "$END_TIME" -k file_create,file_delete,file_modify | grep -c "type=")"
echo "æƒé™å˜æ›´äº‹ä»¶: $(ausearch -ts "$START_TIME" -te "$END_TIME" -k chmod_calls,chown_calls | grep -c "type=")"

echo "================================================="
echo "âœ… åˆ†æå®Œæˆ"
```

### 10.4 å‘Šè­¦é›†æˆæ–¹æ¡ˆ


**ğŸš¨ å®æ—¶å‘Šè­¦ç³»ç»Ÿ**
```bash
#!/bin/bash
# å®æ—¶æ–‡ä»¶å®¡è®¡å‘Šè­¦ç³»ç»Ÿ

# é…ç½®å‘Šè­¦é˜ˆå€¼
CRITICAL_FILES="/etc/passwd /etc/shadow /etc/sudoers"
ALERT_EMAIL="admin@company.com"
ALERT_WEBHOOK="https://hooks.slack.com/services/xxx"

# å®æ—¶ç›‘æ§å‡½æ•°
monitor_critical_files() {
    tail -f /var/log/audit/audit.log | while read line; do
        # æ£€æŸ¥æ˜¯å¦ä¸ºå…³é”®æ–‡ä»¶æ“ä½œ
        if echo "$line" | grep -q "critical_auth\|critical_sudo"; then
            # æå–è¯¦ç»†ä¿¡æ¯
            timestamp=$(echo "$line" | grep -oP 'msg=audit\(\K[^)]+')
            file=$(echo "$line" | grep -oP 'name="\K[^"]+')
            user=$(echo "$line" | grep -oP 'uid=\K[0-9]+')
            
            # æ„é€ å‘Šè­¦æ¶ˆæ¯
            alert_msg="ğŸš¨ å…³é”®æ–‡ä»¶æ“ä½œå‘Šè­¦
æ—¶é—´: $(date -d @${timestamp%.*})
æ–‡ä»¶: $file  
ç”¨æˆ·: $user
è¯¦æƒ…: $line"
            
            # å‘é€å‘Šè­¦
            echo "$alert_msg" | mail -s "æ–‡ä»¶å®¡è®¡å‘Šè­¦" "$ALERT_EMAIL"
            
            # å‘é€åˆ° Slackï¼ˆå¦‚æœé…ç½®äº†ï¼‰
            if [[ ! -z "$ALERT_WEBHOOK" ]]; then
                curl -X POST -H 'Content-type: application/json' \
                    --data "{\"text\":\"$alert_msg\"}" \
                    "$ALERT_WEBHOOK"
            fi
            
            # è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—
            logger -p local0.warning "AUDIT_ALERT: $alert_msg"
        fi
    done
}

# å¯åŠ¨ç›‘æ§
echo "ğŸš€ å¯åŠ¨æ–‡ä»¶å®¡è®¡å®æ—¶å‘Šè­¦ç›‘æ§..."
monitor_critical_files
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ–‡ä»¶ç³»ç»Ÿå®¡è®¡ï¼šç›‘æ§è®°å½•æ–‡ä»¶æ“ä½œè¡Œä¸ºçš„å®‰å…¨æœºåˆ¶
ğŸ”¸ auditd å·¥ä½œåŸç†ï¼šå†…æ ¸å®¡è®¡ â†’ auditd è¿›ç¨‹ â†’ æ—¥å¿—æ–‡ä»¶
ğŸ”¸ ç›‘æ§æƒé™ç±»å‹ï¼šè¯»å–(r)ã€å†™å…¥(w)ã€æ‰§è¡Œ(x)ã€å±æ€§(a)
ğŸ”¸ å®¡è®¡è§„åˆ™è¯­æ³•ï¼šauditctl -w è·¯å¾„ -p æƒé™ -k æ ‡ç­¾
ğŸ”¸ æ—¥å¿—åˆ†æå·¥å…·ï¼šausearch æœç´¢ã€aureport æŠ¥å‘Šç”Ÿæˆ
```

### 11.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ ç›‘æ§é…ç½®ç­–ç•¥**
```
åˆ†å±‚ç›‘æ§åŸåˆ™ï¼š
- å…³é”®æ–‡ä»¶ï¼šå…¨æƒé™ç›‘æ§ (-p rwa)
- é…ç½®æ–‡ä»¶ï¼šå†™å…¥å’Œå±æ€§ç›‘æ§ (-p wa)  
- æ•æ„Ÿæ•°æ®ï¼šè¯»å–ç›‘æ§ (-p r)
- ç³»ç»Ÿç›®å½•ï¼šé€‰æ‹©æ€§ç›‘æ§

æ€§èƒ½å¹³è¡¡ï¼š
- é¿å…ç›‘æ§é«˜é¢‘æ“ä½œç›®å½• (/tmp, /var/log)
- ä½¿ç”¨ç²¾ç¡®çš„æ–‡ä»¶è·¯å¾„è€Œéå¹¿æ³›çš„ç›®å½•
- åˆç†è®¾ç½®æ—¥å¿—è½®è½¬å’Œæ¸…ç†ç­–ç•¥
```

**ğŸ”¹ å®é™…åº”ç”¨æŒ‡å¯¼**
```
ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼š
âœ… ä¼˜å…ˆç›‘æ§ç³»ç»Ÿè®¤è¯æ–‡ä»¶
âœ… ç›‘æ§åº”ç”¨é…ç½®æ–‡ä»¶å˜æ›´
âœ… è®¾ç½®å…³é”®æ“ä½œå®æ—¶å‘Šè­¦
âœ… å®šæœŸåˆ†æå®¡è®¡æ—¥å¿—

å®‰å…¨åˆè§„è¦æ±‚ï¼š
âœ… ä¿è¯å®¡è®¡æ—¥å¿—å®Œæ•´æ€§
âœ… é˜²æ­¢å®¡è®¡è§„åˆ™è¢«ç»•è¿‡
âœ… å»ºç«‹æ—¥å¿—å¤‡ä»½æœºåˆ¶
âœ… é…ç½®é€‚å½“çš„è®¿é—®æ§åˆ¶
```

### 11.3 å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥


**ğŸ”§ åŸºç¡€æ“ä½œå‘½ä»¤**
```bash
# æ·»åŠ ç›‘æ§è§„åˆ™
auditctl -w /etc/passwd -p rwa -k passwd_monitor

# æŸ¥çœ‹å½“å‰è§„åˆ™
auditctl -l

# åˆ é™¤è§„åˆ™
auditctl -W /etc/passwd -p rwa -k passwd_monitor

# æœç´¢å®¡è®¡è®°å½•
ausearch -k passwd_monitor -ts recent

# ç”Ÿæˆå®¡è®¡æŠ¥å‘Š
aureport -f -ts today
```

**ğŸ” æ—¥å¿—åˆ†æå‘½ä»¤**
```bash
# æŒ‰æ—¶é—´æœç´¢
ausearch -ts yesterday -te today

# æŒ‰ç”¨æˆ·æœç´¢
ausearch -ui 1000

# æŒ‰æ–‡ä»¶æœç´¢
ausearch -f /etc/passwd

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/audit/audit.log | grep "key=passwd_monitor"
```

### 11.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ’¡ éƒ¨ç½²å»ºè®®**
- **æ¸è¿›å¼éƒ¨ç½²**ï¼šå…ˆç›‘æ§å…³é”®æ–‡ä»¶ï¼Œé€æ­¥æ‰©å±•èŒƒå›´
- **æµ‹è¯•ç¯å¢ƒéªŒè¯**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯è§„åˆ™æ•ˆæœ
- **æ€§èƒ½ç›‘æ§**ï¼šå…³æ³¨ç³»ç»Ÿæ€§èƒ½å½±å“ï¼ŒåŠæ—¶è°ƒæ•´è§„åˆ™
- **æ–‡æ¡£è®°å½•**ï¼šè¯¦ç»†è®°å½•ç›‘æ§è§„åˆ™å’Œæ ‡ç­¾å«ä¹‰

**ğŸ›¡ï¸ å®‰å…¨å»ºè®®**
- **æƒé™æœ€å°åŒ–**ï¼šåªç»™å¿…è¦ç”¨æˆ·å®¡è®¡æ—¥å¿—è®¿é—®æƒé™
- **å®Œæ•´æ€§ä¿æŠ¤**ï¼šä½¿ç”¨æ•°å­—ç­¾åä¿æŠ¤å®¡è®¡æ—¥å¿—
- **å¤‡ä»½ç­–ç•¥**ï¼šå»ºç«‹å¯é çš„æ—¥å¿—å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
- **å®šæœŸå®¡æŸ¥**ï¼šå®šæœŸæ£€æŸ¥å’Œæ›´æ–°å®¡è®¡è§„åˆ™

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æ–‡ä»¶å®¡è®¡æ˜¯å®‰å…¨é˜²æŠ¤çš„é‡è¦æ‰‹æ®µï¼Œé€šè¿‡ç›‘æ§æ–‡ä»¶æ“ä½œå‘ç°å¼‚å¸¸
- auditctl æ˜¯é…ç½®å®¡è®¡è§„åˆ™çš„æ ¸å¿ƒå·¥å…·ï¼Œ-w æŒ‡å®šè·¯å¾„ï¼Œ-p æŒ‡å®šæƒé™ï¼Œ-k è®¾ç½®æ ‡ç­¾
- åˆ†å±‚ç›‘æ§ç­–ç•¥å¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½ï¼Œå…³é”®æ–‡ä»¶å…¨é¢ç›‘æ§ï¼Œä¸€èˆ¬æ–‡ä»¶é€‰æ‹©ç›‘æ§
- å®¡è®¡æ—¥å¿—éœ€è¦å®šæœŸåˆ†æå’Œæ¸…ç†ï¼Œå»ºç«‹è‡ªåŠ¨åŒ–çš„å‘Šè­¦å’ŒæŠ¥å‘Šæœºåˆ¶