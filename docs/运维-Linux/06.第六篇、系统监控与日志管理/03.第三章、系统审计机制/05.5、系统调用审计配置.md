---
title: 5ã€ç³»ç»Ÿè°ƒç”¨å®¡è®¡é…ç½®
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿè°ƒç”¨å®¡è®¡æ¦‚è¿°](#1-ç³»ç»Ÿè°ƒç”¨å®¡è®¡æ¦‚è¿°)
2. [ç³»ç»Ÿè°ƒç”¨åˆ†ç±»ä¸é€‰æ‹©](#2-ç³»ç»Ÿè°ƒç”¨åˆ†ç±»ä¸é€‰æ‹©)
3. [è¿›ç¨‹æ‰§è¡Œå®¡è®¡ï¼ˆexecveï¼‰](#3-è¿›ç¨‹æ‰§è¡Œå®¡è®¡execve)
4. [æ–‡ä»¶æ“ä½œå®¡è®¡ï¼ˆopen/openatï¼‰](#4-æ–‡ä»¶æ“ä½œå®¡è®¡openopenat)
5. [æƒé™å˜æ›´å®¡è®¡ï¼ˆchmod/chownï¼‰](#5-æƒé™å˜æ›´å®¡è®¡chmodchown)
6. [æŒ‚è½½æ“ä½œå®¡è®¡ï¼ˆmount/umountï¼‰](#6-æŒ‚è½½æ“ä½œå®¡è®¡mountumount)
7. [ç½‘ç»œè¿æ¥å®¡è®¡](#7-ç½‘ç»œè¿æ¥å®¡è®¡)
8. [è¿›ç¨‹é—´é€šä¿¡å®¡è®¡](#8-è¿›ç¨‹é—´é€šä¿¡å®¡è®¡)
9. [æ—¶é—´ç›¸å…³ç³»ç»Ÿè°ƒç”¨å®¡è®¡](#9-æ—¶é—´ç›¸å…³ç³»ç»Ÿè°ƒç”¨å®¡è®¡)
10. [å®è·µé…ç½®ä¸ä¼˜åŒ–](#10-å®è·µé…ç½®ä¸ä¼˜åŒ–)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç³»ç»Ÿè°ƒç”¨å®¡è®¡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿè°ƒç”¨å®¡è®¡


**ğŸ”¸ ç®€å•ç†è§£**
```
ç³»ç»Ÿè°ƒç”¨ = ç¨‹åºå‘æ“ä½œç³»ç»Ÿè¯·æ±‚æœåŠ¡çš„æ–¹å¼
å®¡è®¡ = è®°å½•è¿™äº›è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯

å°±åƒé“¶è¡Œè®°å½•æ¯ç¬”äº¤æ˜“ä¸€æ ·ï¼Œ
auditdè®°å½•æ¯ä¸ªç¨‹åºå¯¹ç³»ç»Ÿçš„"è¯·æ±‚"
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å®¡è®¡ç³»ç»Ÿè°ƒç”¨**
- **å®‰å…¨ç›‘æ§**ï¼šå‘ç°å¼‚å¸¸è¡Œä¸ºå’Œæ½œåœ¨æ”»å‡»
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³å®‰å…¨æ ‡å‡†å’Œæ³•è§„è¦æ±‚
- **æ•…éšœæ’æŸ¥**ï¼šå®šä½ç³»ç»Ÿé—®é¢˜å’Œæ€§èƒ½ç“¶é¢ˆ
- **è¡Œä¸ºåˆ†æ**ï¼šäº†è§£ç¨‹åºè¿è¡Œæ¨¡å¼

### 1.2 ç³»ç»Ÿè°ƒç”¨å®¡è®¡çš„å·¥ä½œåŸç†


```
ç”¨æˆ·ç¨‹åº              å†…æ ¸                auditd
    |                  |                    |
    |--ç³»ç»Ÿè°ƒç”¨-------->|                    |
    |                  |--å®¡è®¡äº‹ä»¶---------->|
    |<--è¿”å›ç»“æœ--------|                    |
    |                  |                    |--å†™å…¥æ—¥å¿—
```

**ğŸ”§ æ ¸å¿ƒç»„ä»¶**
- **å†…æ ¸å®¡è®¡æ¡†æ¶**ï¼šåœ¨å†…æ ¸ä¸­æ•è·ç³»ç»Ÿè°ƒç”¨
- **auditdå®ˆæŠ¤è¿›ç¨‹**ï¼šå¤„ç†å’Œè®°å½•å®¡è®¡äº‹ä»¶
- **å®¡è®¡è§„åˆ™**ï¼šå®šä¹‰å“ªäº›è°ƒç”¨éœ€è¦è®°å½•
- **æ—¥å¿—æ–‡ä»¶**ï¼šå­˜å‚¨å®¡è®¡è®°å½•çš„åœ°æ–¹

### 1.3 å®¡è®¡è§„åˆ™çš„åŸºæœ¬è¯­æ³•


```bash
# åŸºæœ¬æ ¼å¼
-a action,list -S syscall -F field=value -k key

# å‚æ•°è¯´æ˜
action: always(æ€»æ˜¯è®°å½•) | never(ä»ä¸è®°å½•)
list: exit(ç³»ç»Ÿè°ƒç”¨é€€å‡ºæ—¶) | entry(ç³»ç»Ÿè°ƒç”¨è¿›å…¥æ—¶)
syscall: è¦å®¡è®¡çš„ç³»ç»Ÿè°ƒç”¨åç§°
field: è¿‡æ»¤æ¡ä»¶å­—æ®µ
key: ç”¨äºæœç´¢çš„å…³é”®å­—æ ‡ç­¾
```

---

## 2. ğŸ“‹ ç³»ç»Ÿè°ƒç”¨åˆ†ç±»ä¸é€‰æ‹©


### 2.1 ç³»ç»Ÿè°ƒç”¨çš„ä¸»è¦åˆ†ç±»


```
æ–‡ä»¶æ“ä½œç±»ï¼š
â”œâ”€â”€ open, openat     # æ‰“å¼€æ–‡ä»¶
â”œâ”€â”€ read, write      # è¯»å†™æ“ä½œ
â”œâ”€â”€ chmod, chown     # æƒé™å˜æ›´
â””â”€â”€ unlink, rename   # åˆ é™¤é‡å‘½å

è¿›ç¨‹ç®¡ç†ç±»ï¼š
â”œâ”€â”€ execve           # æ‰§è¡Œç¨‹åº
â”œâ”€â”€ fork, clone      # åˆ›å»ºè¿›ç¨‹
â”œâ”€â”€ kill             # å‘é€ä¿¡å·
â””â”€â”€ exit             # è¿›ç¨‹é€€å‡º

ç½‘ç»œé€šä¿¡ç±»ï¼š
â”œâ”€â”€ socket           # åˆ›å»ºå¥—æ¥å­—
â”œâ”€â”€ connect          # å»ºç«‹è¿æ¥
â”œâ”€â”€ bind, listen     # ç»‘å®šç›‘å¬
â””â”€â”€ sendto, recvfrom # æ•°æ®ä¼ è¾“

ç³»ç»Ÿç®¡ç†ç±»ï¼š
â”œâ”€â”€ mount, umount    # æŒ‚è½½æ“ä½œ
â”œâ”€â”€ stime, clock_*   # æ—¶é—´è®¾ç½®
â”œâ”€â”€ syslog           # ç³»ç»Ÿæ—¥å¿—
â””â”€â”€ reboot           # ç³»ç»Ÿé‡å¯
```

### 2.2 å¦‚ä½•é€‰æ‹©è¦å®¡è®¡çš„ç³»ç»Ÿè°ƒç”¨


**ğŸ¯ é€‰æ‹©åŸåˆ™**

| é‡è¦ç­‰çº§ | **ç³»ç»Ÿè°ƒç”¨ç±»å‹** | **å®¡è®¡å»ºè®®** | **åŸå› è¯´æ˜** |
|---------|----------------|-------------|-------------|
| ğŸ”´ **é«˜å±** | `execve, mount, stime` | `å¿…é¡»å®¡è®¡` | `ç›´æ¥å½±å“ç³»ç»Ÿå®‰å…¨` |
| ğŸŸ¡ **ä¸­ç­‰** | `open, chmod, connect` | `é€‰æ‹©æ€§å®¡è®¡` | `å¯èƒ½æ¶‰åŠæ•æ„Ÿæ“ä½œ` |
| ğŸŸ¢ **ä½å±** | `read, write, getpid` | `è°¨æ…å®¡è®¡` | `é¢‘ç¹è°ƒç”¨ï¼Œæ—¥å¿—é‡å¤§` |

**ğŸ’¡ å®é™…é€‰æ‹©ç­–ç•¥**
```bash
# å®‰å…¨é‡ç‚¹é…ç½®ï¼ˆæ¨èï¼‰
-a always,exit -S execve -k process_execution
-a always,exit -S mount -S umount -k mount_operations
-a always,exit -S chmod -S chown -k permission_changes

# è¯¦ç»†ç›‘æ§é…ç½®ï¼ˆé«˜å®‰å…¨ç¯å¢ƒï¼‰
-a always,exit -S open -S openat -k file_access
-a always,exit -S connect -S bind -k network_activity

# æœ€å°é…ç½®ï¼ˆæ€§èƒ½ä¼˜å…ˆï¼‰
-a always,exit -S execve -S mount -S stime -k critical_calls
```

### 2.3 ç³»ç»Ÿè°ƒç”¨å·ä¸åç§°å¯¹åº”


```bash
# æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨å·
ausyscall --dump | head -10

# è¾“å‡ºç¤ºä¾‹ï¼š
0       read
1       write  
2       open
3       close
59      execve
165     mount
166     umount
```

**âš¡ å¿«é€ŸæŸ¥è¯¢æŠ€å·§**
```bash
# æŒ‰åç§°æŸ¥è¯¢è°ƒç”¨å·
ausyscall execve

# æŒ‰è°ƒç”¨å·æŸ¥è¯¢åç§°  
ausyscall 59

# æŸ¥çœ‹æ¶æ„ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨
ausyscall --exact open
```

---

## 3. ğŸš€ è¿›ç¨‹æ‰§è¡Œå®¡è®¡ï¼ˆexecveï¼‰


### 3.1 execveç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯execve**
```
execve = æ‰§è¡Œç¨‹åºçš„ç³»ç»Ÿè°ƒç”¨
å½“ä½ åœ¨å‘½ä»¤è¡Œè¾“å…¥ç¨‹åºåæ—¶ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨execve

ä¾‹å¦‚ï¼šè¾“å…¥ "ls" å‘½ä»¤
shellä¼šè°ƒç”¨execve("/bin/ls", ["ls"], env)æ¥æ‰§è¡Œlsç¨‹åº
```

**ğŸ¯ ä¸ºä»€ä¹ˆè¦å®¡è®¡execve**
- **æ¶æ„ç¨‹åºæ‰§è¡Œ**ï¼šå‘ç°æœªæˆæƒçš„ç¨‹åºè¿è¡Œ
- **ææƒæ”»å‡»**ï¼šç›‘æ§sudoã€suç­‰ç‰¹æƒç¨‹åº
- **å¼‚å¸¸è¡Œä¸º**ï¼šå‘ç°ç³»ç»Ÿä¸­å¼‚å¸¸çš„ç¨‹åºæ‰§è¡Œ
- **åˆè§„å®¡è®¡**ï¼šè®°å½•æ‰€æœ‰ç¨‹åºæ‰§è¡Œå†å²

### 3.2 execveå®¡è®¡é…ç½®è¯¦è§£


**ğŸ“ åŸºç¡€é…ç½®**
```bash
# å®¡è®¡æ‰€æœ‰ç¨‹åºæ‰§è¡Œ
-a always,exit -S execve -k program_execution

# å®¡è®¡ç‰¹å®šç”¨æˆ·çš„ç¨‹åºæ‰§è¡Œ
-a always,exit -S execve -F uid=1000 -k user_execution

# å®¡è®¡ç‰¹æƒç¨‹åºæ‰§è¡Œï¼ˆsudoç›¸å…³ï¼‰
-a always,exit -S execve -F euid=0 -k privileged_execution
```

**ğŸ”§ é«˜çº§è¿‡æ»¤é…ç½®**
```bash
# æ’é™¤ç³»ç»Ÿè¿›ç¨‹ï¼Œåªç›‘æ§ç”¨æˆ·è¿›ç¨‹
-a always,exit -S execve -F uid>=1000 -k user_programs

# ç›‘æ§ç‰¹å®šç›®å½•ä¸‹çš„ç¨‹åºæ‰§è¡Œ
-a always,exit -S execve -F path=/tmp -k temp_execution
-a always,exit -S execve -F path=/home -k home_execution

# ç›‘æ§å…·æœ‰SUIDæƒé™çš„ç¨‹åº
-a always,exit -S execve -F perm=x -F fsgid!=egid -k suid_execution
```

### 3.3 execveå®¡è®¡æ—¥å¿—è§£è¯»


**ğŸ“Š æ—¥å¿—ç¤ºä¾‹**
```
type=SYSCALL msg=audit(1642147200.123:456): arch=c000003e syscall=59 
success=yes exit=0 a0=7fff12345678 a1=7fff12345690 a2=7fff123456a8 
items=2 ppid=1234 pid=5678 auid=1000 uid=1000 gid=1000 euid=0 suid=0 
fsuid=0 egid=1000 sgid=1000 fsgid=1000 tty=pts0 ses=1 comm="sudo" 
exe="/usr/bin/sudo" key="privileged_execution"

type=EXECVE msg=audit(1642147200.123:456): argc=3 a0="sudo" a1="ls" a2="/root"

type=PATH msg=audit(1642147200.123:456): item=0 name="/usr/bin/sudo" 
inode=123456 dev=08:01 mode=0104755 ouid=0 ogid=0 rdev=00:00 
nametype=NORMAL cap_fp=0000001fffffffff cap_fi=0000001fffffffff
```

**ğŸ” å…³é”®å­—æ®µè§£é‡Š**
- **syscall=59**ï¼šç³»ç»Ÿè°ƒç”¨å·ï¼ˆexecveï¼‰
- **comm="sudo"**ï¼šæ‰§è¡Œçš„å‘½ä»¤åç§°
- **exe="/usr/bin/sudo"**ï¼šå¯æ‰§è¡Œæ–‡ä»¶å®Œæ•´è·¯å¾„
- **argc=3, a0="sudo"**ï¼šå‘½ä»¤è¡Œå‚æ•°
- **uid=1000, euid=0**ï¼šçœŸå®ç”¨æˆ·IDå’Œæœ‰æ•ˆç”¨æˆ·ID

### 3.4 å¸¸è§execveå®¡è®¡åœºæ™¯


**ğŸ›¡ï¸ å®‰å…¨ç›‘æ§åœºæ™¯**
```bash
# ç›‘æ§shellæ‰§è¡Œï¼ˆå¯èƒ½çš„åå¼¹shellï¼‰
-a always,exit -S execve -F path=/bin/bash -k shell_execution
-a always,exit -S execve -F path=/bin/sh -k shell_execution

# ç›‘æ§ç½‘ç»œå·¥å…·ä½¿ç”¨
-a always,exit -S execve -F path=/usr/bin/nc -k network_tools
-a always,exit -S execve -F path=/usr/bin/nmap -k network_tools

# ç›‘æ§ç³»ç»Ÿç®¡ç†å·¥å…·
-a always,exit -S execve -F path=/usr/bin/passwd -k admin_tools
-a always,exit -S execve -F path=/usr/sbin/useradd -k admin_tools
```

---

## 4. ğŸ“ æ–‡ä»¶æ“ä½œå®¡è®¡ï¼ˆopen/openatï¼‰


### 4.1 openå’Œopenatç³»ç»Ÿè°ƒç”¨è§£é‡Š


**ğŸ”¸ ä»€ä¹ˆæ˜¯open/openat**
```
open = æ‰“å¼€æ–‡ä»¶çš„ä¼ ç»Ÿæ–¹å¼
openat = ç›¸å¯¹äºç›®å½•æ–‡ä»¶æè¿°ç¬¦æ‰“å¼€æ–‡ä»¶ï¼ˆæ›´å®‰å…¨ï¼‰

ç®€å•ç†è§£ï¼š
ç¨‹åºè¦è¯»å†™æ–‡ä»¶æ—¶ï¼Œå¿…é¡»å…ˆ"æ‰“å¼€"æ–‡ä»¶
å°±åƒè¦çœ‹ä¹¦å¿…é¡»å…ˆç¿»å¼€ä¹¦ä¸€æ ·
```

**ğŸ’¡ ä¸¤è€…çš„åŒºåˆ«**
```
open("/home/user/file.txt", O_RDONLY);
# ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•

openat(dirfd, "file.txt", O_RDONLY);  
# ç›¸å¯¹äºæŒ‡å®šç›®å½•ï¼ˆæ›´å®‰å…¨ï¼Œé¿å…ç«æ€æ¡ä»¶ï¼‰
```

### 4.2 æ–‡ä»¶æ“ä½œå®¡è®¡é…ç½®


**ğŸ“ åŸºç¡€æ–‡ä»¶è®¿é—®å®¡è®¡**
```bash
# å®¡è®¡æ‰€æœ‰æ–‡ä»¶æ‰“å¼€æ“ä½œ
-a always,exit -S open -S openat -k file_access

# å®¡è®¡æ•æ„Ÿç›®å½•çš„æ–‡ä»¶è®¿é—®
-a always,exit -S open -S openat -F dir=/etc -k config_access
-a always,exit -S open -S openat -F dir=/var/log -k log_access
-a always,exit -S open -S openat -F dir=/home -k user_file_access
```

**ğŸ”’ å®‰å…¨ç›¸å…³æ–‡ä»¶å®¡è®¡**
```bash
# ç›‘æ§å¯†ç æ–‡ä»¶è®¿é—®
-w /etc/passwd -p wa -k passwd_changes
-w /etc/shadow -p wa -k shadow_changes
-w /etc/group -p wa -k group_changes

# ç›‘æ§SSHé…ç½®è®¿é—®
-w /etc/ssh/sshd_config -p wa -k ssh_config
-w /root/.ssh -p wa -k root_ssh_access

# ç›‘æ§sudoé…ç½®
-w /etc/sudoers -p wa -k sudo_config
-w /etc/sudoers.d/ -p wa -k sudo_config
```

### 4.3 æ–‡ä»¶æ“ä½œæ ‡å¿—è§£è¯»


**ğŸ”§ openç³»ç»Ÿè°ƒç”¨æ ‡å¿—**
```bash
# å¸¸è§çš„æ–‡ä»¶æ‰“å¼€æ ‡å¿—
O_RDONLY    = 0      # åªè¯»æ¨¡å¼
O_WRONLY    = 1      # åªå†™æ¨¡å¼  
O_RDWR      = 2      # è¯»å†™æ¨¡å¼
O_CREAT     = 64     # åˆ›å»ºæ–‡ä»¶
O_TRUNC     = 512    # æ¸…ç©ºæ–‡ä»¶
O_APPEND    = 1024   # è¿½åŠ æ¨¡å¼
```

**ğŸ“Š å®é™…å®¡è®¡é…ç½®ç¤ºä¾‹**
```bash
# ç›‘æ§æ–‡ä»¶åˆ›å»ºæ“ä½œ
-a always,exit -S open -S openat -F a1&O_CREAT -k file_creation

# ç›‘æ§æ–‡ä»¶åˆ é™¤/æ¸…ç©ºæ“ä½œ
-a always,exit -S open -S openat -F a1&O_TRUNC -k file_truncation

# ç›‘æ§å¯æ‰§è¡Œæ–‡ä»¶è®¿é—®
-a always,exit -S open -S openat -F perm=x -k executable_access
```

### 4.4 æ–‡ä»¶è®¿é—®æ—¥å¿—åˆ†æ


**ğŸ“‹ æ—¥å¿—ç¤ºä¾‹**
```
type=SYSCALL msg=audit(1642147300.456:789): arch=c000003e syscall=2 
success=yes exit=3 a0=7fff87654321 a1=0 a2=1b6 items=1 ppid=1000 
pid=2000 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 
egid=1000 sgid=1000 fsgid=1000 tty=pts0 ses=1 comm="cat" 
exe="/usr/bin/cat" key="file_access"

type=PATH msg=audit(1642147300.456:789): item=0 name="/etc/passwd" 
inode=789012 dev=08:01 mode=0100644 ouid=0 ogid=0 rdev=00:00 
nametype=NORMAL
```

**ğŸ” å…³é”®ä¿¡æ¯è§£è¯»**
- **syscall=2**ï¼šopenç³»ç»Ÿè°ƒç”¨
- **a1=0**ï¼šO_RDONLYï¼ˆåªè¯»æ¨¡å¼ï¼‰
- **name="/etc/passwd"**ï¼šè®¿é—®çš„æ–‡ä»¶è·¯å¾„
- **mode=0100644**ï¼šæ–‡ä»¶æƒé™ï¼ˆ644æƒé™çš„æ™®é€šæ–‡ä»¶ï¼‰

---

## 5. ğŸ” æƒé™å˜æ›´å®¡è®¡ï¼ˆchmod/chownï¼‰


### 5.1 æƒé™å˜æ›´ç³»ç»Ÿè°ƒç”¨è¯´æ˜


**ğŸ”¸ chmodå’Œchownçš„ä½œç”¨**
```
chmod = ä¿®æ”¹æ–‡ä»¶æƒé™ï¼ˆchange modeï¼‰
chown = ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆchange ownerï¼‰

ç”Ÿæ´»ç±»æ¯”ï¼š
chmod å°±åƒæ”¹å˜æˆ¿é—¨é’¥åŒ™çš„ç±»å‹ï¼ˆè°èƒ½è¿›ï¼‰
chown å°±åƒæŠŠæˆ¿å­çš„äº§æƒè½¬ç»™åˆ«äºº
```

**âš ï¸ ä¸ºä»€ä¹ˆè¦å®¡è®¡æƒé™å˜æ›´**
- **ææƒæ”»å‡»**ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹æ–‡ä»¶æƒé™æ¥è·å–è®¿é—®æƒ
- **è¯¯æ“ä½œé˜²æŠ¤**ï¼šè®°å½•æ„å¤–çš„æƒé™ä¿®æ”¹
- **åˆè§„è¦æ±‚**ï¼šæŸäº›æ–‡ä»¶çš„æƒé™å˜æ›´å¿…é¡»æœ‰å®¡è®¡è®°å½•
- **å®‰å…¨åˆ†æ**ï¼šåˆ†æç³»ç»Ÿä¸­çš„æƒé™å˜åŒ–æ¨¡å¼

### 5.2 æƒé™å˜æ›´å®¡è®¡é…ç½®


**ğŸ“ åŸºç¡€æƒé™å®¡è®¡**
```bash
# å®¡è®¡æ‰€æœ‰æƒé™å˜æ›´æ“ä½œ
-a always,exit -S chmod -S fchmod -S chown -S fchown -k permission_changes

# å®¡è®¡ç‰¹å®šç›®å½•çš„æƒé™å˜æ›´
-a always,exit -S chmod -S chown -F dir=/etc -k etc_permission_changes
-a always,exit -S chmod -S chown -F dir=/usr/bin -k bin_permission_changes
```

**ğŸ”’ æ•æ„Ÿæƒé™å˜æ›´ç›‘æ§**
```bash
# ç›‘æ§SUID/SGIDä½è®¾ç½®ï¼ˆé«˜å±æ“ä½œï¼‰
-a always,exit -S chmod -F a1&S_ISUID -k suid_changes
-a always,exit -S chmod -F a1&S_ISGID -k sgid_changes

# ç›‘æ§å¯æ‰§è¡Œæƒé™æ·»åŠ 
-a always,exit -S chmod -F a1&S_IXUSR -k execute_permission_added

# ç›‘æ§rootæ‰€æœ‰æƒå˜æ›´
-a always,exit -S chown -F a1=0 -k root_ownership_changes
```

### 5.3 æƒé™æ•°å€¼è§£è¯»


**ğŸ”¢ Linuxæƒé™æ•°å€¼ç³»ç»Ÿ**
```
æƒé™ä½ç»„æˆï¼š
â”Œâ”€ç‰¹æ®Šæƒé™â”€â”¬â”€æ‰€æœ‰è€…æƒé™â”€â”¬â”€ç»„æƒé™â”€â”¬â”€å…¶ä»–æƒé™â”€â”
â”‚ SUID=4   â”‚ READ=4     â”‚ READ=4 â”‚ READ=4   â”‚
â”‚ SGID=2   â”‚ WRITE=2    â”‚WRITE=2 â”‚ WRITE=2  â”‚  
â”‚ STICKY=1 â”‚EXECUTE=1   â”‚EXEC=1  â”‚ EXEC=1   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¤ºä¾‹ï¼šchmod 4755 file
4 = SUIDä½
7 = æ‰€æœ‰è€…æƒé™ï¼ˆ4+2+1=è¯»å†™æ‰§è¡Œï¼‰
5 = ç»„æƒé™ï¼ˆ4+1=è¯»æ‰§è¡Œï¼‰
5 = å…¶ä»–æƒé™ï¼ˆ4+1=è¯»æ‰§è¡Œï¼‰
```

**âš¡ å¸¸è§æƒé™æ¨¡å¼**
```bash
755 = rwxr-xr-x  # æ ‡å‡†å¯æ‰§è¡Œæ–‡ä»¶æƒé™
644 = rw-r--r--  # æ ‡å‡†æ™®é€šæ–‡ä»¶æƒé™
600 = rw-------  # ç§æœ‰æ–‡ä»¶æƒé™
4755 = rwsr-xr-x # å¸¦SUIDçš„å¯æ‰§è¡Œæ–‡ä»¶
2755 = rwxr-sr-x # å¸¦SGIDçš„å¯æ‰§è¡Œæ–‡ä»¶
1777 = rwxrwxrwt # å¸¦stickyä½çš„ç›®å½•ï¼ˆå¦‚/tmpï¼‰
```

### 5.4 æƒé™å˜æ›´å®¡è®¡å®ä¾‹


**ğŸ“Š å®é™…ç›‘æ§åœºæ™¯**
```bash
# ç›‘æ§å…³é”®ç³»ç»Ÿæ–‡ä»¶æƒé™å˜æ›´
-w /bin/su -p a -k su_permission_changes
-w /usr/bin/sudo -p a -k sudo_permission_changes
-w /etc/passwd -p a -k passwd_permission_changes

# ç›‘æ§ç”¨æˆ·ä¸»ç›®å½•æƒé™å˜æ›´
-a always,exit -S chmod -S chown -F dir=/home -F uid>=1000 -k user_permission_changes

# ç›‘æ§ä¸´æ—¶ç›®å½•å¯ç–‘æƒé™å˜æ›´
-a always,exit -S chmod -F dir=/tmp -F a1&S_ISUID -k temp_suid_changes
```

**ğŸ” æ—¥å¿—åˆ†æç¤ºä¾‹**
```
type=SYSCALL msg=audit(1642147400.789:1011): arch=c000003e syscall=90 
success=yes exit=0 a0=7fff12345678 a1=1ed a2=0 a3=7fff12345680 
items=1 ppid=2000 pid=3000 auid=1000 uid=0 gid=0 euid=0 suid=0 
fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=1 comm="chmod" 
exe="/usr/bin/chmod" key="permission_changes"

# a1=1ed è½¬æ¢ä¸ºåè¿›åˆ¶æ˜¯493ï¼Œå¯¹åº”å…«è¿›åˆ¶755æƒé™
```

---

## 6. ğŸ’¾ æŒ‚è½½æ“ä½œå®¡è®¡ï¼ˆmount/umountï¼‰


### 6.1 æŒ‚è½½æ“ä½œçš„é‡è¦æ€§


**ğŸ”¸ ä»€ä¹ˆæ˜¯æŒ‚è½½**
```
æŒ‚è½½(mount) = æŠŠæ–‡ä»¶ç³»ç»Ÿè¿æ¥åˆ°ç›®å½•æ ‘çš„æŸä¸ªä½ç½®
å¸è½½(umount) = æ–­å¼€æ–‡ä»¶ç³»ç»Ÿçš„è¿æ¥

ç”Ÿæ´»ç±»æ¯”ï¼š
æŒ‚è½½å°±åƒæŠŠUç›˜æ’åˆ°ç”µè„‘ä¸Šï¼Œè®©ç³»ç»Ÿèƒ½è®¿é—®Uç›˜å†…å®¹
å¸è½½å°±åƒå®‰å…¨å¼¹å‡ºUç›˜
```

**ğŸš¨ ä¸ºä»€ä¹ˆæŒ‚è½½æ“ä½œå¾ˆå±é™©**
- **ç»•è¿‡æƒé™æ£€æŸ¥**ï¼šæŒ‚è½½å¯èƒ½è¦†ç›–ç°æœ‰æ–‡ä»¶å’Œæƒé™
- **éšè—æ¶æ„æ–‡ä»¶**ï¼šåœ¨ç³»ç»Ÿç›®å½•ä¸ŠæŒ‚è½½å¯ä»¥éšè—åŸæœ‰å†…å®¹
- **ç‰¹æƒæå‡**ï¼šæŸäº›æŒ‚è½½é€‰é¡¹å¯èƒ½å¯¼è‡´ææƒ
- **æ•°æ®æ³„éœ²**ï¼šä¸å½“çš„æŒ‚è½½å¯èƒ½æš´éœ²æ•æ„Ÿæ•°æ®

### 6.2 æŒ‚è½½æ“ä½œå®¡è®¡é…ç½®


**ğŸ“ åŸºç¡€æŒ‚è½½å®¡è®¡**
```bash
# å®¡è®¡æ‰€æœ‰æŒ‚è½½å’Œå¸è½½æ“ä½œ
-a always,exit -S mount -S umount -S umount2 -k mount_operations

# å®¡è®¡ç‰¹å®šç”¨æˆ·çš„æŒ‚è½½æ“ä½œ
-a always,exit -S mount -F uid>=1000 -k user_mount_operations

# å®¡è®¡rootç”¨æˆ·çš„æŒ‚è½½æ“ä½œ
-a always,exit -S mount -F euid=0 -k root_mount_operations
```

**ğŸ”’ ç‰¹æ®ŠæŒ‚è½½ç›‘æ§**
```bash
# ç›‘æ§ç½‘ç»œæ–‡ä»¶ç³»ç»ŸæŒ‚è½½
-a always,exit -S mount -F a2&MS_BIND -k bind_mount
-a always,exit -S mount -F a2&MS_REMOUNT -k remount_operations

# ç›‘æ§å…·æœ‰ç‰¹æ®Šæƒé™çš„æŒ‚è½½
-a always,exit -S mount -F a2&MS_NOSUID -k nosuid_mount
-a always,exit -S mount -F a2&MS_NOEXEC -k noexec_mount
```

### 6.3 æŒ‚è½½æ ‡å¿—è¯¦è§£


**ğŸ”§ å¸¸è§æŒ‚è½½æ ‡å¿—**
```bash
MS_RDONLY     = 1      # åªè¯»æŒ‚è½½
MS_NOSUID     = 2      # ç¦ç”¨SUID/SGID
MS_NODEV      = 4      # ç¦ç”¨è®¾å¤‡æ–‡ä»¶
MS_NOEXEC     = 8      # ç¦ç”¨æ‰§è¡Œæ–‡ä»¶
MS_REMOUNT    = 32     # é‡æ–°æŒ‚è½½
MS_BIND       = 4096   # ç»‘å®šæŒ‚è½½
```

**âš¡ æŒ‚è½½é€‰é¡¹å®‰å…¨å«ä¹‰**
```
å®‰å…¨æŒ‚è½½é€‰é¡¹ç»„åˆï¼š
nosuid,nodev,noexec = æœ€å®‰å…¨çš„æŒ‚è½½æ–¹å¼
é€‚ç”¨äºï¼šç”¨æˆ·æ•°æ®åˆ†åŒºã€ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ

å±é™©æŒ‚è½½æ“ä½œï¼š
remount = å¯èƒ½æ”¹å˜ç°æœ‰æŒ‚è½½ç‚¹çš„å®‰å…¨é€‰é¡¹
bind = å¯èƒ½åœ¨ç³»ç»Ÿç›®å½•ä¸Šåˆ›å»ºåˆ«å
```

### 6.4 æŒ‚è½½å®¡è®¡å®è·µ


**ğŸ“Š å®é™…ç›‘æ§é…ç½®**
```bash
# ç›‘æ§ç³»ç»Ÿå…³é”®ç›®å½•çš„æŒ‚è½½å˜åŒ–
-w /etc/fstab -p wa -k fstab_changes
-w /proc/mounts -p r -k mount_status_access

# ç›‘æ§å¯ç§»åŠ¨è®¾å¤‡æŒ‚è½½
-a always,exit -S mount -F dir=/media -k removable_mount
-a always,exit -S mount -F dir=/mnt -k temp_mount

# ç›‘æ§ç½‘ç»œæŒ‚è½½
-a always,exit -S mount -F fstype=nfs -k nfs_mount
-a always,exit -S mount -F fstype=cifs -k cifs_mount
```

**ğŸ” æŒ‚è½½æ—¥å¿—åˆ†æ**
```
type=SYSCALL msg=audit(1642147500.123:1234): arch=c000003e syscall=165 
success=yes exit=0 a0=7fff11111111 a1=7fff22222222 a2=7fff33333333 
a3=1000 items=3 ppid=1000 pid=4000 auid=1000 uid=0 gid=0 euid=0 
comm="mount" exe="/usr/bin/mount" key="mount_operations"

type=PATH msg=audit(1642147500.123:1234): item=0 name="/dev/sdb1" 
nametype=NORMAL
type=PATH msg=audit(1642147500.123:1234): item=1 name="/mnt/usb" 
nametype=NORMAL
```

---

## 7. ğŸŒ ç½‘ç»œè¿æ¥å®¡è®¡


### 7.1 ç½‘ç»œç³»ç»Ÿè°ƒç”¨æ¦‚è¿°


**ğŸ”¸ ä¸»è¦ç½‘ç»œç³»ç»Ÿè°ƒç”¨**
```
socket     = åˆ›å»ºç½‘ç»œå¥—æ¥å­—ï¼ˆç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ï¼‰
connect    = å»ºç«‹å®¢æˆ·ç«¯è¿æ¥
bind       = ç»‘å®šåœ°å€åˆ°å¥—æ¥å­—ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰
listen     = ç›‘å¬è¿æ¥è¯·æ±‚
accept     = æ¥å—å®¢æˆ·ç«¯è¿æ¥
sendto     = å‘é€æ•°æ®
recvfrom   = æ¥æ”¶æ•°æ®
```

**ğŸ’¡ ç½‘ç»œå®¡è®¡çš„ä»·å€¼**
- **æ¶æ„è¿æ¥æ£€æµ‹**ï¼šå‘ç°å¼‚å¸¸çš„å¯¹å¤–è¿æ¥
- **æœåŠ¡ç›‘æ§**ï¼šç›‘æ§ç³»ç»Ÿä¸Šå¯åŠ¨çš„ç½‘ç»œæœåŠ¡
- **æ•°æ®ä¼ è¾“è¿½è¸ª**ï¼šè®°å½•æ•æ„Ÿæ•°æ®çš„ç½‘ç»œä¼ è¾“
- **å…¥ä¾µæ£€æµ‹**ï¼šè¯†åˆ«å¯ç–‘çš„ç½‘ç»œæ´»åŠ¨

### 7.2 ç½‘ç»œè¿æ¥å®¡è®¡é…ç½®


**ğŸ“ åŸºç¡€ç½‘ç»œå®¡è®¡**
```bash
# å®¡è®¡æ‰€æœ‰ç½‘ç»œè¿æ¥å»ºç«‹
-a always,exit -S connect -k network_connect

# å®¡è®¡ç½‘ç»œæœåŠ¡ç»‘å®š
-a always,exit -S bind -k network_bind

# å®¡è®¡å¥—æ¥å­—åˆ›å»º
-a always,exit -S socket -k socket_creation
```

**ğŸ”’ é«˜çº§ç½‘ç»œç›‘æ§**
```bash
# ç›‘æ§TCPè¿æ¥ï¼ˆæœ€å¸¸ç”¨çš„ç½‘ç»œåè®®ï¼‰
-a always,exit -S socket -F a0=PF_INET -F a1=SOCK_STREAM -k tcp_socket

# ç›‘æ§UDPè¿æ¥
-a always,exit -S socket -F a0=PF_INET -F a1=SOCK_DGRAM -k udp_socket

# ç›‘æ§UnixåŸŸå¥—æ¥å­—ï¼ˆæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼‰
-a always,exit -S socket -F a0=PF_UNIX -k unix_socket

# ç›‘æ§ç‰¹å®šç«¯å£ç»‘å®š
-a always,exit -S bind -F a0=22 -k ssh_bind    # SSHç«¯å£
-a always,exit -S bind -F a0=80 -k http_bind   # HTTPç«¯å£
-a always,exit -S bind -F a0=443 -k https_bind # HTTPSç«¯å£
```

### 7.3 ç½‘ç»œåè®®å’Œåœ°å€æ—


**ğŸ”§ å¸¸è§åè®®æ—**
```bash
PF_INET   = 2   # IPv4ç½‘ç»œåè®®
PF_INET6  = 10  # IPv6ç½‘ç»œåè®®  
PF_UNIX   = 1   # UnixåŸŸå¥—æ¥å­—ï¼ˆæœ¬åœ°é€šä¿¡ï¼‰
PF_NETLINK = 16 # å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´é€šä¿¡
```

**ğŸ“Š å¥—æ¥å­—ç±»å‹**
```bash
SOCK_STREAM = 1    # TCPæµå¥—æ¥å­—ï¼ˆå¯é ä¼ è¾“ï¼‰
SOCK_DGRAM  = 2    # UDPæ•°æ®æŠ¥å¥—æ¥å­—ï¼ˆå¿«é€Ÿä¼ è¾“ï¼‰
SOCK_RAW    = 3    # åŸå§‹å¥—æ¥å­—ï¼ˆåº•å±‚è®¿é—®ï¼‰
```

### 7.4 ç½‘ç»œå®¡è®¡åº”ç”¨åœºæ™¯


**ğŸ›¡ï¸ å®‰å…¨ç›‘æ§å®ä¾‹**
```bash
# ç›‘æ§åå‘shellè¿æ¥ï¼ˆå¸¸è§æ”»å‡»æ‰‹æ®µï¼‰
-a always,exit -S connect -F a0=2 -F success=1 -k reverse_shell_attempt

# ç›‘æ§é«˜æƒé™ç”¨æˆ·çš„ç½‘ç»œæ´»åŠ¨
-a always,exit -S socket -S connect -F euid=0 -k root_network_activity

# ç›‘æ§éæ ‡å‡†ç«¯å£ä½¿ç”¨
-a always,exit -S bind -F a0>1024 -F euid=0 -k high_port_bind

# ç›‘æ§å¤–éƒ¨è¿æ¥
-a always,exit -S connect -F saddr!=127.0.0.1 -k external_connect
```

**ğŸ“‹ ç½‘ç»œæ—¥å¿—åˆ†æ**
```
type=SYSCALL msg=audit(1642147600.456:1456): arch=c000003e syscall=42 
success=yes exit=0 a0=3 a1=7fff44444444 a2=10 a3=0 items=0 ppid=1000 
pid=5000 auid=1000 uid=1000 gid=1000 euid=1000 comm="ssh" 
exe="/usr/bin/ssh" key="network_connect"

type=SOCKADDR msg=audit(1642147600.456:1456): saddr=02001016C0A80164000000000000000000000000
# saddrè§£æï¼š02001016 = åè®®æ—+ç«¯å£ï¼ŒC0A80164 = IPåœ°å€192.168.1.100
```

---

## 8. ğŸ”„ è¿›ç¨‹é—´é€šä¿¡å®¡è®¡


### 8.1 è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶æ¦‚è¿°


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰**
```
IPC = Inter-Process Communication
ä¸åŒè¿›ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®å’Œä¿¡æ¯çš„æ–¹å¼

å°±åƒä¸¤ä¸ªäººè¦å¯¹è¯ï¼š
- é¢å¯¹é¢è¯´è¯ = å…±äº«å†…å­˜
- å†™çº¸æ¡ä¼ é€’ = æ¶ˆæ¯é˜Ÿåˆ—  
- æ‰“ç”µè¯ = ç®¡é“é€šä¿¡
- é‚®å¯„ä¿¡ä»¶ = ä¿¡å·é€šä¿¡
```

**ğŸ’¡ ä¸»è¦IPCæœºåˆ¶**
```
System V IPC:
â”œâ”€â”€ æ¶ˆæ¯é˜Ÿåˆ— (msgget, msgsnd, msgrcv)
â”œâ”€â”€ å…±äº«å†…å­˜ (shmget, shmat, shmdt)  
â””â”€â”€ ä¿¡å·é‡ (semget, semop)

POSIX IPC:
â”œâ”€â”€ å‘½åç®¡é“ (mkfifo)
â”œâ”€â”€ ä¿¡å· (kill, sigaction)
â””â”€â”€ å¥—æ¥å­— (socket - æœ¬åœ°é€šä¿¡)
```

### 8.2 IPCå®¡è®¡é…ç½®


**ğŸ“ System V IPCå®¡è®¡**
```bash
# å®¡è®¡æ¶ˆæ¯é˜Ÿåˆ—æ“ä½œ
-a always,exit -S msgget -S msgsnd -S msgrcv -k message_queue

# å®¡è®¡å…±äº«å†…å­˜æ“ä½œ
-a always,exit -S shmget -S shmat -S shmdt -k shared_memory

# å®¡è®¡ä¿¡å·é‡æ“ä½œ
-a always,exit -S semget -S semop -k semaphore_ops
```

**ğŸ”’ ä¿¡å·å’Œç®¡é“å®¡è®¡**
```bash
# å®¡è®¡è¿›ç¨‹ä¿¡å·å‘é€
-a always,exit -S kill -k signal_sending

# å®¡è®¡ç®¡é“åˆ›å»º
-a always,exit -S pipe -S pipe2 -k pipe_creation

# å®¡è®¡å‘½åç®¡é“æ“ä½œ
-w /tmp -p wa -F path~fifo -k named_pipe_ops
```

### 8.3 IPCå®‰å…¨é£é™©


**âš ï¸ IPCç›¸å…³å®‰å…¨é£é™©**
```
å…±äº«å†…å­˜é£é™©ï¼š
- æ•°æ®æ³„éœ²ï¼šä¸åŒè¿›ç¨‹å¯èƒ½è®¿é—®ç›¸åŒå†…å­˜åŒºåŸŸ
- æƒé™ç»•è¿‡ï¼šé€šè¿‡å…±äº«å†…å­˜ä¼ é€’æ•æ„Ÿä¿¡æ¯

æ¶ˆæ¯é˜Ÿåˆ—é£é™©ï¼š
- ä¿¡æ¯çªƒå–ï¼šæ¶æ„è¿›ç¨‹å¯èƒ½è¯»å–å…¶ä»–è¿›ç¨‹çš„æ¶ˆæ¯
- æ‹’ç»æœåŠ¡ï¼šå¡«æ»¡æ¶ˆæ¯é˜Ÿåˆ—å¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½

ä¿¡å·é£é™©ï¼š
- è¿›ç¨‹æ§åˆ¶ï¼šæ¶æ„è¿›ç¨‹å¯èƒ½æ§åˆ¶å…¶ä»–è¿›ç¨‹
- æƒé™æå‡ï¼šé€šè¿‡ä¿¡å·å¤„ç†ç¨‹åºææƒ
```

### 8.4 IPCå®¡è®¡å®è·µ


**ğŸ›¡ï¸ å®é™…ç›‘æ§é…ç½®**
```bash
# ç›‘æ§è·¨ç”¨æˆ·IPCæ“ä½œ
-a always,exit -S msgget -S shmget -S semget -F uid!=euid -k cross_user_ipc

# ç›‘æ§å¤§å®¹é‡å…±äº«å†…å­˜åˆ›å»º
-a always,exit -S shmget -F a1>1048576 -k large_shm_creation  # >1MB

# ç›‘æ§ä¿¡å·å‘é€ç»™ç³»ç»Ÿè¿›ç¨‹
-a always,exit -S kill -F a0<1000 -k signal_to_system_process

# ç›‘æ§ä¸´æ—¶ç›®å½•ä¸­çš„å‘½åç®¡é“
-w /tmp -p wa -F filetype=fifo -k temp_named_pipe
```

**ğŸ“Š IPCæ—¥å¿—è§£æ**
```
type=SYSCALL msg=audit(1642147700.789:1678): arch=c000003e syscall=68 
success=yes exit=0 a0=539 a1=0 a2=0 a3=0 items=0 ppid=2000 pid=6000 
auid=1000 uid=1000 gid=1000 euid=1000 comm="program" 
exe="/usr/bin/program" key="message_queue"

# syscall=68 è¡¨ç¤º msggetç³»ç»Ÿè°ƒç”¨
# a0=539 è¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—çš„keyå€¼
```

---

## 9. â° æ—¶é—´ç›¸å…³ç³»ç»Ÿè°ƒç”¨å®¡è®¡


### 9.1 æ—¶é—´ç³»ç»Ÿè°ƒç”¨çš„é‡è¦æ€§


**ğŸ”¸ ä¸»è¦æ—¶é—´ç›¸å…³ç³»ç»Ÿè°ƒç”¨**
```
stime          = è®¾ç½®ç³»ç»Ÿæ—¶é—´ï¼ˆå·²åºŸå¼ƒï¼‰
clock_settime  = è®¾ç½®æ—¶é’Ÿæ—¶é—´ï¼ˆç°ä»£æ–¹å¼ï¼‰
settimeofday   = è®¾ç½®æ—¶é—´å’Œæ—¶åŒº
adjtimex       = è°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿ
```

**ğŸš¨ ä¸ºä»€ä¹ˆè¦å®¡è®¡æ—¶é—´å˜æ›´**
- **æ—¥å¿—ä¼ªé€ **ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹æ—¶é—´æ¥ä¼ªé€ æ—¥å¿—æ—¶é—´æˆ³
- **è®¤è¯ç»•è¿‡**ï¼šæŸäº›åŸºäºæ—¶é—´çš„è®¤è¯å¯èƒ½è¢«ç»•è¿‡
- **åˆè§„è¦æ±‚**ï¼šé‡‘èç­‰è¡Œä¸šè¦æ±‚ä¸¥æ ¼çš„æ—¶é—´å®¡è®¡
- **å–è¯éœ€è¦**ï¼šæ—¶é—´å˜æ›´ä¼šå½±å“äº‹ä»¶æ—¶é—´çº¿åˆ†æ

### 9.2 æ—¶é—´å®¡è®¡é…ç½®


**ğŸ“ åŸºç¡€æ—¶é—´å®¡è®¡**
```bash
# å®¡è®¡æ‰€æœ‰æ—¶é—´å˜æ›´æ“ä½œ
-a always,exit -S stime -S settimeofday -S clock_settime -k time_changes

# å®¡è®¡æ—¶é’Ÿè°ƒæ•´æ“ä½œ
-a always,exit -S adjtimex -k clock_adjustment
```

**ğŸ”’ é«˜ç²¾åº¦æ—¶é—´ç›‘æ§**
```bash
# ç›‘æ§ç³»ç»Ÿæ—¶é’Ÿè®¾ç½®
-a always,exit -S clock_settime -F a0=CLOCK_REALTIME -k realtime_change

# ç›‘æ§å•è°ƒæ—¶é’Ÿè®¾ç½®ï¼ˆä¸åº”è¯¥è¢«è®¾ç½®ï¼‰
-a always,exit -S clock_settime -F a0=CLOCK_MONOTONIC -k monotonic_change

# ç›‘æ§æ—¶åŒºå˜æ›´
-w /etc/localtime -p wa -k timezone_changes
-w /etc/timezone -p wa -k timezone_changes
```

### 9.3 æ—¶é’Ÿç±»å‹è¯¦è§£


**ğŸ”§ Linuxæ—¶é’Ÿç±»å‹**
```bash
CLOCK_REALTIME     = 0  # ç³»ç»Ÿå®æ—¶æ—¶é’Ÿï¼ˆå¯è®¾ç½®ï¼‰
CLOCK_MONOTONIC    = 1  # å•è°ƒæ—¶é’Ÿï¼ˆä¸å¯é€†è½¬ï¼‰
CLOCK_PROCESS_CPUTIME_ID = 2  # è¿›ç¨‹CPUæ—¶é—´
CLOCK_THREAD_CPUTIME_ID = 3   # çº¿ç¨‹CPUæ—¶é—´
CLOCK_BOOTTIME     = 7  # å¯åŠ¨æ—¶é—´ï¼ˆåŒ…å«ä¼‘çœ ï¼‰
```

**âš¡ æ—¶é—´å®‰å…¨è€ƒè™‘**
```
å¯è®¾ç½®çš„æ—¶é’Ÿï¼šCLOCK_REALTIME
- å½±å“ï¼šç³»ç»Ÿæ—¶é—´ã€æ—¥å¿—æ—¶é—´æˆ³ã€æ–‡ä»¶æ—¶é—´æˆ³
- é£é™©ï¼šå¯èƒ½è¢«æ¶æ„ä¿®æ”¹

ä¸å¯è®¾ç½®çš„æ—¶é’Ÿï¼šCLOCK_MONOTONIC
- ç‰¹ç‚¹ï¼šåªèƒ½é€’å¢ï¼Œä¸å—ç³»ç»Ÿæ—¶é—´å˜æ›´å½±å“
- ç”¨é€”ï¼šè®¡ç®—æ—¶é—´é—´éš”ã€æ€§èƒ½æµ‹é‡
```

### 9.4 æ—¶é—´å®¡è®¡å®è·µ


**ğŸ“Š å®é™…ç›‘æ§é…ç½®**
```bash
# ç›‘æ§NTPæ—¶é—´åŒæ­¥ç›¸å…³
-w /etc/ntp.conf -p wa -k ntp_config_changes
-a always,exit -S clock_settime -F comm=ntpd -k ntp_time_sync

# ç›‘æ§æ‰‹åŠ¨æ—¶é—´è®¾ç½®
-a always,exit -S clock_settime -F comm=date -k manual_time_change
-a always,exit -S settimeofday -F comm=date -k manual_timeofday_change

# ç›‘æ§æ—¶é—´æœåŠ¡å™¨è®¿é—®
-a always,exit -S connect -F dport=123 -k ntp_server_connect  # NTPç«¯å£
```

**ğŸ” æ—¶é—´å˜æ›´æ—¥å¿—åˆ†æ**
```
type=SYSCALL msg=audit(1642147800.123:1890): arch=c000003e syscall=227 
success=yes exit=0 a0=0 a1=7fff55555555 a2=0 a3=7fff55555566 
items=0 ppid=1000 pid=7000 auid=1000 uid=0 gid=0 euid=0 
comm="date" exe="/usr/bin/date" key="time_changes"

# syscall=227 è¡¨ç¤º clock_settime
# a0=0 è¡¨ç¤º CLOCK_REALTIME
# æ—¶é—´å˜æ›´çš„å…·ä½“å€¼éœ€è¦è§£æa1æŒ‡å‘çš„æ—¶é—´ç»“æ„
```

---

## 10. âš™ï¸ å®è·µé…ç½®ä¸ä¼˜åŒ–


### 10.1 ç³»ç»Ÿè°ƒç”¨å®¡è®¡æœ€ä½³å®è·µ


**ğŸ¯ é…ç½®ç­–ç•¥é€‰æ‹©**

| ç¯å¢ƒç±»å‹ | **å®¡è®¡ç­–ç•¥** | **æ¨èé…ç½®** | **æ€§èƒ½å½±å“** |
|---------|-------------|-------------|-------------|
| ğŸ”´ **é«˜å®‰å…¨ç¯å¢ƒ** | `å…¨é¢å®¡è®¡` | `æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨` | `é«˜å½±å“` |
| ğŸŸ¡ **ç”Ÿäº§ç¯å¢ƒ** | `å¹³è¡¡é…ç½®` | `å…³é”®è°ƒç”¨+è¿‡æ»¤` | `ä¸­ç­‰å½±å“` |
| ğŸŸ¢ **å¼€å‘ç¯å¢ƒ** | `æœ€å°é…ç½®` | `ä»…execve+mount` | `ä½å½±å“` |

**ğŸ’¡ å®ç”¨é…ç½®æ¨¡æ¿**
```bash
# æœ€å°å®‰å…¨é…ç½®ï¼ˆæ€§èƒ½ä¼˜å…ˆï¼‰
-a always,exit -S execve -k process_execution
-a always,exit -S mount -S umount -k mount_operations  
-a always,exit -S stime -S clock_settime -k time_changes

# æ ‡å‡†å®‰å…¨é…ç½®ï¼ˆå¹³è¡¡æ€§èƒ½ä¸å®‰å…¨ï¼‰
-a always,exit -S execve -F uid>=1000 -k user_process_execution
-a always,exit -S open -S openat -F dir=/etc -k config_access
-a always,exit -S chmod -S chown -F dir=/etc -k etc_permission_changes
-a always,exit -S connect -F success=1 -k network_connections

# é«˜å®‰å…¨é…ç½®ï¼ˆå®‰å…¨ä¼˜å…ˆï¼‰
-a always,exit -S execve -k all_process_execution
-a always,exit -S open -S openat -k all_file_access
-a always,exit -S chmod -S chown -S fchmod -S fchown -k all_permission_changes
-a always,exit -S socket -S connect -S bind -k all_network_activity
```

### 10.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**âš¡ å‡å°‘å®¡è®¡å¼€é”€**
```bash
# ä½¿ç”¨UIDè¿‡æ»¤ï¼Œæ’é™¤ç³»ç»Ÿè¿›ç¨‹
-a always,exit -S execve -F uid>=1000 -k user_execution

# ä½¿ç”¨ç›®å½•è¿‡æ»¤ï¼Œåªç›‘æ§å…³é”®è·¯å¾„
-a always,exit -S open -F dir=/etc -k etc_access
-a always,exit -S open -F dir=/var/log -k log_access

# ä½¿ç”¨æˆåŠŸçŠ¶æ€è¿‡æ»¤ï¼Œåªè®°å½•æˆåŠŸçš„æ“ä½œ
-a always,exit -S connect -F success=1 -k successful_connections

# æ’é™¤é¢‘ç¹ä½†ä¸é‡è¦çš„è°ƒç”¨
-a never,exit -S read -S write -S lseek
```

**ğŸ“Š ç›‘æ§å®¡è®¡æ€§èƒ½**
```bash
# æ£€æŸ¥å®¡è®¡é˜Ÿåˆ—çŠ¶æ€
auditctl -s

# æŸ¥çœ‹å®¡è®¡è§„åˆ™æ•°é‡
auditctl -l | wc -l

# ç›‘æ§å®¡è®¡æ—¥å¿—å¤§å°å¢é•¿
ls -lh /var/log/audit/audit.log

# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
top -p $(pgrep auditd)
```

### 10.3 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ”§ å¸¸è§é—®é¢˜åŠè§£å†³**
```bash
# é—®é¢˜1ï¼šå®¡è®¡è§„åˆ™ä¸ç”Ÿæ•ˆ
# æ’æŸ¥æ­¥éª¤ï¼š
auditctl -l  # æŸ¥çœ‹å½“å‰è§„åˆ™
auditctl -s  # æŸ¥çœ‹å®¡è®¡çŠ¶æ€
systemctl status auditd  # æ£€æŸ¥æœåŠ¡çŠ¶æ€

# é—®é¢˜2ï¼šæ—¥å¿—æ–‡ä»¶è¿‡å¤§
# è§£å†³æ–¹æ¡ˆï¼š
# é…ç½®æ—¥å¿—è½®è½¬
cat > /etc/audit/rules.d/rotate.rules << EOF
-f 1  # å¯ç”¨æ—¥å¿—è½®è½¬
-r 1000  # é™åˆ¶æ¯ç§’è®°å½•æ•°
EOF

# é—®é¢˜3ï¼šç³»ç»Ÿæ€§èƒ½ä¸‹é™
# è§£å†³æ–¹æ¡ˆï¼š
# å‡å°‘å®¡è®¡è§„åˆ™æ•°é‡
auditctl -D  # åˆ é™¤æ‰€æœ‰è§„åˆ™
# é‡æ–°åŠ è½½ç²¾ç®€çš„è§„åˆ™

# é—®é¢˜4ï¼šç£ç›˜ç©ºé—´ä¸è¶³
# è§£å†³æ–¹æ¡ˆï¼š
# é…ç½®è‡ªåŠ¨åˆ é™¤æ—§æ—¥å¿—
vim /etc/audit/auditd.conf
max_log_file_action = rotate
num_logs = 5
```

### 10.4 å®¡è®¡è§„åˆ™ç®¡ç†


**ğŸ“ è§„åˆ™æ–‡ä»¶ç»„ç»‡**
```bash
# è§„åˆ™æ–‡ä»¶ç›®å½•ç»“æ„
/etc/audit/rules.d/
â”œâ”€â”€ 10-base.rules          # åŸºç¡€é…ç½®
â”œâ”€â”€ 20-syscalls.rules      # ç³»ç»Ÿè°ƒç”¨è§„åˆ™
â”œâ”€â”€ 30-network.rules       # ç½‘ç»œç›¸å…³è§„åˆ™
â”œâ”€â”€ 40-files.rules         # æ–‡ä»¶è®¿é—®è§„åˆ™
â””â”€â”€ 99-finalize.rules      # æœ€ç»ˆé…ç½®

# è§„åˆ™åŠ è½½é¡ºåºå¾ˆé‡è¦ï¼
# æ–‡ä»¶æŒ‰å­—æ¯é¡ºåºåŠ è½½ï¼Œæ•°å­—å‰ç¼€ç¡®ä¿é¡ºåº
```

**ğŸ”„ è§„åˆ™æ›´æ–°æµç¨‹**
```bash
# 1. ç¼–è¾‘è§„åˆ™æ–‡ä»¶
vim /etc/audit/rules.d/20-syscalls.rules

# 2. æ£€æŸ¥è¯­æ³•
auditctl -R /etc/audit/rules.d/20-syscalls.rules

# 3. é‡æ–°åŠ è½½æ‰€æœ‰è§„åˆ™
augenrules --load

# 4. éªŒè¯è§„åˆ™ç”Ÿæ•ˆ
auditctl -l | grep syscall

# 5. æµ‹è¯•å®¡è®¡è®°å½•
ausearch -k your_key_name
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ç³»ç»Ÿè°ƒç”¨å®¡è®¡ï¼šè®°å½•ç¨‹åºå¯¹æ“ä½œç³»ç»Ÿçš„è¯·æ±‚
ğŸ”¸ æ ¸å¿ƒç³»ç»Ÿè°ƒç”¨ï¼šexecve(è¿›ç¨‹æ‰§è¡Œ)ã€open(æ–‡ä»¶è®¿é—®)ã€chmod(æƒé™å˜æ›´)
ğŸ”¸ ç½‘ç»œå®¡è®¡ï¼šsocketã€connectã€bindç­‰ç½‘ç»œç›¸å…³è°ƒç”¨
ğŸ”¸ IPCå®¡è®¡ï¼šè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶çš„ç›‘æ§
ğŸ”¸ æ—¶é—´å®¡è®¡ï¼šç³»ç»Ÿæ—¶é—´å˜æ›´çš„ç›‘æ§
ğŸ”¸ æ€§èƒ½å¹³è¡¡ï¼šåœ¨å®‰å…¨æ€§å’Œç³»ç»Ÿæ€§èƒ½é—´æ‰¾åˆ°å¹³è¡¡ç‚¹
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç³»ç»Ÿè°ƒç”¨å®¡è®¡çš„ä»·å€¼**
```
å®‰å…¨é˜²æŠ¤ï¼š
- æ£€æµ‹æ¶æ„ç¨‹åºæ‰§è¡Œå’Œå¼‚å¸¸è¡Œä¸º
- ç›‘æ§æƒé™å˜æ›´å’Œç³»ç»Ÿé…ç½®ä¿®æ”¹
- è¿½è¸ªç½‘ç»œè¿æ¥å’Œæ•°æ®ä¼ è¾“

åˆè§„å®¡è®¡ï¼š
- æ»¡è¶³å®‰å…¨æ ‡å‡†è¦æ±‚
- æä¾›å®Œæ•´çš„æ“ä½œå®¡è®¡è½¨è¿¹
- æ”¯æŒäº‹åè°ƒæŸ¥å’Œåˆ†æ

è¿ç»´æ”¯æŒï¼š
- æ•…éšœæ’æŸ¥å’Œæ€§èƒ½åˆ†æ
- ç³»ç»Ÿè¡Œä¸ºæ¨¡å¼åˆ†æ
- å®‰å…¨äº‹ä»¶å“åº”
```

**ğŸ”¹ é…ç½®åŸåˆ™**
```
åˆ†å±‚é…ç½®ï¼š
åŸºç¡€å±‚ï¼šå…³é”®ç³»ç»Ÿè°ƒç”¨ï¼ˆexecveã€mountã€æ—¶é—´å˜æ›´ï¼‰
å®‰å…¨å±‚ï¼šæ–‡ä»¶è®¿é—®ã€æƒé™å˜æ›´ã€ç½‘ç»œæ´»åŠ¨
è¯¦ç»†å±‚ï¼šå®Œæ•´çš„ç³»ç»Ÿè°ƒç”¨å®¡è®¡

è¿‡æ»¤ç­–ç•¥ï¼š
ç”¨æˆ·è¿‡æ»¤ï¼šåŒºåˆ†ç³»ç»Ÿè¿›ç¨‹å’Œç”¨æˆ·è¿›ç¨‹
è·¯å¾„è¿‡æ»¤ï¼šåªç›‘æ§å…³é”®ç›®å½•å’Œæ–‡ä»¶
çŠ¶æ€è¿‡æ»¤ï¼šåªè®°å½•æˆåŠŸæˆ–å¤±è´¥çš„æ“ä½œ
```

### 11.3 å®é™…åº”ç”¨ä»·å€¼


- **å…¥ä¾µæ£€æµ‹**ï¼šå®æ—¶å‘ç°ç³»ç»Ÿä¸­çš„å¼‚å¸¸æ´»åŠ¨
- **åˆè§„å®¡è®¡**ï¼šæ»¡è¶³å„ç§å®‰å…¨æ ‡å‡†å’Œæ³•è§„è¦æ±‚
- **äº‹ä»¶å“åº”**ï¼šä¸ºå®‰å…¨äº‹ä»¶è°ƒæŸ¥æä¾›è¯¦ç»†è¯æ®
- **ç³»ç»Ÿä¼˜åŒ–**ï¼šé€šè¿‡å®¡è®¡æ•°æ®åˆ†æç³»ç»Ÿä½¿ç”¨æ¨¡å¼
- **æ•…éšœæ’æŸ¥**ï¼šå®šä½ç³»ç»Ÿé—®é¢˜çš„æ ¹æœ¬åŸå› 

### 11.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ é…ç½®å»ºè®®**
```
ç”Ÿäº§ç¯å¢ƒï¼š
- å®¡è®¡å…³é”®ç³»ç»Ÿè°ƒç”¨å’Œæ•æ„Ÿæ–‡ä»¶è®¿é—®
- ä½¿ç”¨è¿‡æ»¤æ¡ä»¶å‡å°‘æ—¥å¿—é‡
- é…ç½®æ—¥å¿—è½®è½¬å’Œç©ºé—´ç®¡ç†
- å®šæœŸç›‘æ§å®¡è®¡ç³»ç»Ÿæ€§èƒ½

å¼€å‘ç¯å¢ƒï¼š
- æœ€å°åŒ–å®¡è®¡é…ç½®
- é‡ç‚¹å…³æ³¨å®‰å…¨ç›¸å…³æ“ä½œ
- ä¾¿äºè°ƒè¯•å’Œé—®é¢˜å®šä½

é«˜å®‰å…¨ç¯å¢ƒï¼š
- å…¨é¢çš„ç³»ç»Ÿè°ƒç”¨å®¡è®¡
- å®æ—¶å‘Šè­¦å’Œåˆ†æ
- å†—ä½™å¤‡ä»½å’Œå®Œæ•´æ€§ä¿æŠ¤
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ç³»ç»Ÿè°ƒç”¨è¿å†…æ ¸ï¼Œå®¡è®¡è®°å½•æŠ¤å®‰å…¨
- execveç›‘æ§ç¨‹åºè·‘ï¼Œopenç›‘æ§æ–‡ä»¶æ“ä½œ
- chmodæƒé™è¦å°å¿ƒï¼ŒmountæŒ‚è½½æ›´å±é™©  
- ç½‘ç»œæ—¶é—´å’Œé€šä¿¡ï¼Œé…ç½®è¿‡æ»¤ä¿æ€§èƒ½