---
title: 2ã€auditdå®‰è£…é…ç½®ä¸å¯åŠ¨ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [auditdç³»ç»Ÿå®¡è®¡æ¦‚è¿°](#1-auditdç³»ç»Ÿå®¡è®¡æ¦‚è¿°)
2. [auditdè½¯ä»¶åŒ…å®‰è£…](#2-auditdè½¯ä»¶åŒ…å®‰è£…)
3. [systemctlæœåŠ¡ç®¡ç†](#3-systemctlæœåŠ¡ç®¡ç†)
4. [auditd.confä¸»é…ç½®æ–‡ä»¶è¯¦è§£](#4-auditdconfä¸»é…ç½®æ–‡ä»¶è¯¦è§£)
5. [æ—¥å¿—æ–‡ä»¶è½®è½¬é…ç½®](#5-æ—¥å¿—æ–‡ä»¶è½®è½¬é…ç½®)
6. [ç£ç›˜ç©ºé—´ç®¡ç†ç­–ç•¥](#6-ç£ç›˜ç©ºé—´ç®¡ç†ç­–ç•¥)
7. [æœåŠ¡ä¾èµ–ä¸å¼€æœºè‡ªå¯](#7-æœåŠ¡ä¾èµ–ä¸å¼€æœºè‡ªå¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” auditdç³»ç»Ÿå®¡è®¡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯auditd

**é€šä¿—ç†è§£**ï¼šauditdå°±åƒæ˜¯ç³»ç»Ÿçš„"ç›‘æ§æ‘„åƒå¤´"ï¼Œä¸“é—¨è®°å½•ç³»ç»Ÿä¸­å‘ç”Ÿçš„å„ç§æ“ä½œã€‚

```
æ—¥å¸¸ç”Ÿæ´»ç±»æ¯”ï¼š
é“¶è¡ŒATMæœºä¼šè®°å½•æ¯æ¬¡å–æ¬¾æ“ä½œ
é—¨ç¦ç³»ç»Ÿä¼šè®°å½•æ¯æ¬¡åˆ·å¡è¿›å‡º
auditdå°±æ˜¯Linuxç³»ç»Ÿçš„"æ“ä½œè®°å½•ä»ª"

è®°å½•å†…å®¹åŒ…æ‹¬ï¼š
â€¢ è°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆæ“ä½œ
â€¢ è®¿é—®äº†å“ªäº›æ–‡ä»¶
â€¢ æ‰§è¡Œäº†ä»€ä¹ˆå‘½ä»¤
â€¢ æ˜¯å¦æˆåŠŸæˆ–å¤±è´¥
```

### 1.2 auditdçš„æ ¸å¿ƒä½œç”¨

**ğŸ¯ ä¸»è¦åŠŸèƒ½**ï¼š
- **å®‰å…¨ç›‘æ§** - å‘ç°å¯ç–‘æ“ä½œå’Œå…¥ä¾µè¡Œä¸º
- **åˆè§„å®¡è®¡** - æ»¡è¶³å®‰å…¨æ ‡å‡†å’Œæ³•è§„è¦æ±‚
- **æ•…éšœæ’æŸ¥** - è¿½è¸ªç³»ç»Ÿé—®é¢˜çš„æ ¹æœ¬åŸå› 
- **æ“ä½œè¿½æº¯** - æŸ¥æ‰¾ç‰¹å®šæ—¶é—´çš„ç³»ç»Ÿå˜æ›´

### 1.3 auditdç³»ç»Ÿæ¶æ„


```
auditdç³»ç»Ÿç»„ä»¶å…³ç³»å›¾ï¼š

åº”ç”¨ç¨‹åº/ç”¨æˆ·æ“ä½œ
        â†“
    å†…æ ¸å®¡è®¡æ¨¡å— (audit kernel module)
        â†“
    auditdå®ˆæŠ¤è¿›ç¨‹
        â†“
    å®¡è®¡æ—¥å¿—æ–‡ä»¶ (/var/log/audit/audit.log)
        â†“
    æ—¥å¿—åˆ†æå·¥å…· (ausearch, aureport)
```

**æ ¸å¿ƒç»„ä»¶è¯´æ˜**ï¼š
- **å†…æ ¸æ¨¡å—** - åœ¨å†…æ ¸çº§åˆ«æ•è·ç³»ç»Ÿè°ƒç”¨
- **auditdè¿›ç¨‹** - ç”¨æˆ·ç©ºé—´çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå¤„ç†å’Œå­˜å‚¨æ—¥å¿—
- **é…ç½®æ–‡ä»¶** - æ§åˆ¶å®¡è®¡è§„åˆ™å’Œè¡Œä¸º
- **æ—¥å¿—æ–‡ä»¶** - å­˜å‚¨æ‰€æœ‰å®¡è®¡è®°å½•

---

## 2. ğŸ“¦ auditdè½¯ä»¶åŒ…å®‰è£…


### 2.1 å¿…éœ€è½¯ä»¶åŒ…ä»‹ç»


**ğŸ”¸ æ ¸å¿ƒè½¯ä»¶åŒ…**
```bash
# ä¸»è¦è½¯ä»¶åŒ…
audit          # auditdå®ˆæŠ¤è¿›ç¨‹å’ŒåŸºæœ¬å·¥å…·
audit-libs     # å®¡è®¡ç³»ç»Ÿçš„åº“æ–‡ä»¶
```

**å„è½¯ä»¶åŒ…ä½œç”¨è¯¦è§£**ï¼š

| è½¯ä»¶åŒ… | **ä¸»è¦å†…å®¹** | **ä½œç”¨è¯´æ˜** |
|--------|-------------|-------------|
| **audit** | `auditdå®ˆæŠ¤è¿›ç¨‹ã€auditctlå‘½ä»¤å·¥å…·` | `æ ¸å¿ƒæœåŠ¡ï¼Œè´Ÿè´£æ”¶é›†å’Œå­˜å‚¨å®¡è®¡æ—¥å¿—` |
| **audit-libs** | `libauditåº“æ–‡ä»¶ã€APIæ¥å£` | `æä¾›ç¼–ç¨‹æ¥å£ï¼Œæ”¯æŒå…¶ä»–ç¨‹åºè°ƒç”¨å®¡è®¡åŠŸèƒ½` |

### 2.2 æ£€æŸ¥å®‰è£…çŠ¶æ€


**æ£€æŸ¥æ˜¯å¦å·²å®‰è£…**ï¼š
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨rpmæŸ¥è¯¢
rpm -qa | grep audit

# æ–¹æ³•2ï¼šä½¿ç”¨yum/dnfæŸ¥è¯¢
yum list installed | grep audit

# æ–¹æ³•3ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status auditd
```

### 2.3 è½¯ä»¶åŒ…å®‰è£…æ“ä½œ


#### CentOS/RHELç³»ç»Ÿå®‰è£…

```bash
# ä½¿ç”¨yumå®‰è£…ï¼ˆCentOS 7åŠä»¥ä¸‹ï¼‰
sudo yum install audit audit-libs

# ä½¿ç”¨dnfå®‰è£…ï¼ˆCentOS 8åŠä»¥ä¸Šï¼‰
sudo dnf install audit audit-libs

# ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰ç›¸å…³åŒ…
sudo yum install audit audit-libs audit-libs-devel
```

#### Ubuntu/Debianç³»ç»Ÿå®‰è£…

```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£…auditd
sudo apt install auditd audispd-plugins

# æ£€æŸ¥å®‰è£…ç»“æœ
dpkg -l | grep audit
```

**ğŸ’¡ å®‰è£…éªŒè¯**ï¼š
```bash
# éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ
which auditd        # æ£€æŸ¥auditdç¨‹åºä½ç½®
which auditctl      # æ£€æŸ¥ç®¡ç†å·¥å…·
ls -l /etc/audit/   # æ£€æŸ¥é…ç½®ç›®å½•
```

---

## 3. âš™ï¸ systemctlæœåŠ¡ç®¡ç†


### 3.1 auditdæœåŠ¡åŸºæœ¬æ“ä½œ


**ğŸ”¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤**
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status auditd

# å¯åŠ¨æœåŠ¡
sudo systemctl start auditd

# åœæ­¢æœåŠ¡
sudo systemctl stop auditd

# é‡å¯æœåŠ¡
sudo systemctl restart auditd

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload auditd
```

### 3.2 æœåŠ¡çŠ¶æ€è¯¦è§£


**æŸ¥çœ‹è¯¦ç»†çŠ¶æ€ä¿¡æ¯**ï¼š
```bash
# æŸ¥çœ‹å®Œæ•´çŠ¶æ€
systemctl status auditd -l

# æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯ç”¨
systemctl is-enabled auditd

# æŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œ
systemctl is-active auditd
```

**ğŸ” çŠ¶æ€ä¿¡æ¯è§£è¯»**ï¼š
```
â— auditd.service - Security Auditing Service
   Loaded: loaded (/usr/lib/systemd/system/auditd.service; enabled; vendor preset: enabled)
   Active: active (running) since Mon 2025-01-15 10:30:45 CST; 2h 15min ago
   â†‘        â†‘
   çŠ¶æ€     è¿è¡Œæ—¶é—´
```

### 3.3 æœåŠ¡å¯åœæ³¨æ„äº‹é¡¹


**âš ï¸ ç‰¹æ®Šè¯´æ˜**ï¼š
```
auditdæœåŠ¡çš„ç‰¹æ®Šæ€§ï¼š
â€¢ ä¸èƒ½ä½¿ç”¨æ™®é€šçš„systemctl reload
â€¢ éœ€è¦ä½¿ç”¨service auditd reloadï¼ˆéƒ¨åˆ†ç³»ç»Ÿï¼‰
â€¢ æˆ–è€…å‘é€SIGUSR1ä¿¡å·ç»™auditdè¿›ç¨‹

åŸå› ï¼šauditdç›´æ¥ä¸å†…æ ¸é€šä¿¡ï¼Œé‡è½½æ–¹å¼ç‰¹æ®Š
```

**æ­£ç¡®çš„é‡è½½æ–¹å¼**ï¼š
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨serviceå‘½ä»¤
sudo service auditd reload

# æ–¹æ³•2ï¼šå‘é€ä¿¡å·
sudo kill -USR1 $(pidof auditd)

# æ–¹æ³•3ï¼šä½¿ç”¨auditctlå‘½ä»¤
sudo auditctl -R /etc/audit/audit.rules
```

---

## 4. ğŸ“‹ auditd.confä¸»é…ç½®æ–‡ä»¶è¯¦è§£


### 4.1 é…ç½®æ–‡ä»¶ä½ç½®ä¸ä½œç”¨


**ğŸ“ é…ç½®æ–‡ä»¶è·¯å¾„**ï¼š`/etc/audit/auditd.conf`

**é…ç½®æ–‡ä»¶ä½œç”¨**ï¼š
- æ§åˆ¶auditdå®ˆæŠ¤è¿›ç¨‹çš„è¡Œä¸º
- è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼
- å®šä¹‰ç£ç›˜ç©ºé—´ä¸è¶³æ—¶çš„å¤„ç†ç­–ç•¥
- é…ç½®æ—¥å¿—è½®è½¬å’Œä¿ç•™ç­–ç•¥

### 4.2 æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£


#### ğŸ“‚ æ—¥å¿—æ–‡ä»¶é…ç½®

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
sudo cat /etc/audit/auditd.conf

# æ ¸å¿ƒé…ç½®ç¤ºä¾‹
log_file = /var/log/audit/audit.log      # æ—¥å¿—æ–‡ä»¶è·¯å¾„
log_format = RAW                         # æ—¥å¿—æ ¼å¼ï¼ˆRAW/ENRICHEDï¼‰
```

**é…ç½®å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | **é»˜è®¤å€¼** | **è¯´æ˜** | **æ¨èè®¾ç½®** |
|------|-----------|----------|-------------|
| `log_file` | `/var/log/audit/audit.log` | `å®¡è®¡æ—¥å¿—å­˜å‚¨ä½ç½®` | `æ ¹æ®ç£ç›˜ç©ºé—´è°ƒæ•´` |
| `log_format` | `RAW` | `æ—¥å¿—æ ¼å¼ç±»å‹` | `RAWï¼ˆæ€§èƒ½æ›´å¥½ï¼‰` |
| `log_group` | `root` | `æ—¥å¿—æ–‡ä»¶æ‰€å±ç»„` | `ä¿æŒé»˜è®¤` |

#### ğŸ”„ æ—¥å¿—è½®è½¬å‚æ•°

```bash
# æ—¥å¿—è½®è½¬ç›¸å…³é…ç½®
max_log_file = 8                         # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§MBæ•°
num_logs = 5                             # ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡
max_log_file_action = ROTATE             # æ—¥å¿—æ–‡ä»¶æ»¡æ—¶çš„åŠ¨ä½œ
```

**è½®è½¬é…ç½®è¯´æ˜**ï¼š
```
è½®è½¬æœºåˆ¶å·¥ä½œåŸç†ï¼š
å½“audit.logè¾¾åˆ°8MBæ—¶ï¼š
1. audit.log â†’ audit.log.1
2. audit.log.1 â†’ audit.log.2
3. ...æœ€å¤šä¿ç•™5ä¸ªæ–‡ä»¶
4. åˆ›å»ºæ–°çš„audit.logç»§ç»­è®°å½•

é…ç½®å»ºè®®ï¼š
â€¢ max_log_fileï¼šæ ¹æ®ç£ç›˜ç©ºé—´è®¾ç½®ï¼ˆ8-100MBï¼‰
â€¢ num_logsï¼šæ ¹æ®ä¿ç•™éœ€æ±‚è®¾ç½®ï¼ˆ5-10ä¸ªï¼‰
```

#### ğŸ’¾ ç£ç›˜ç©ºé—´ç®¡ç†

```bash
# ç£ç›˜ç©ºé—´ç›‘æ§é…ç½®
space_left = 75                          # å‰©ä½™ç©ºé—´é˜ˆå€¼ï¼ˆMBï¼‰
space_left_action = SYSLOG              # ç©ºé—´ä¸è¶³æ—¶çš„åŠ¨ä½œ
admin_space_left = 50                    # ç®¡ç†å‘˜ç©ºé—´é˜ˆå€¼ï¼ˆMBï¼‰
admin_space_left_action = SUSPEND       # ç®¡ç†å‘˜ç©ºé—´ä¸è¶³åŠ¨ä½œ
```

### 4.3 é…ç½®æ–‡ä»¶ç¤ºä¾‹


**ğŸ”§ å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š
```bash
# /etc/audit/auditd.conf æ¨èé…ç½®

# åŸºæœ¬è®¾ç½®
local_events = yes
write_logs = yes
log_file = /var/log/audit/audit.log
log_group = root
log_format = RAW

# æ—¥å¿—è½®è½¬è®¾ç½®
max_log_file = 20
num_logs = 8
max_log_file_action = ROTATE

# ç£ç›˜ç©ºé—´ç®¡ç†
space_left = 200
space_left_action = SYSLOG
admin_space_left = 100
admin_space_left_action = SUSPEND
disk_full_action = SUSPEND
disk_error_action = SUSPEND

# ç½‘ç»œè®¾ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
tcp_listen_port = 60
tcp_max_per_addr = 1
```

### 4.4 é…ç½®ä¿®æ”¹ä¸ç”Ÿæ•ˆ


**ä¿®æ”¹é…ç½®æ­¥éª¤**ï¼š
```bash
# 1. å¤‡ä»½åŸé…ç½®
sudo cp /etc/audit/auditd.conf /etc/audit/auditd.conf.bak

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo vi /etc/audit/auditd.conf

# 3. æ£€æŸ¥é…ç½®è¯­æ³•
sudo auditd -t

# 4. é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
sudo systemctl restart auditd
```

---

## 5. ğŸ”„ æ—¥å¿—æ–‡ä»¶è½®è½¬é…ç½®


### 5.1 è½®è½¬æœºåˆ¶åŸç†


**ğŸ“Š è½®è½¬å·¥ä½œæµç¨‹**ï¼š
```
æ—¥å¿—è½®è½¬è¿‡ç¨‹å›¾ç¤ºï¼š

å½“å‰çŠ¶æ€ï¼šaudit.log (7.9MB)
å†™å…¥æ•°æ®ï¼šç»§ç»­è®°å½•å®¡è®¡äº‹ä»¶
è¾¾åˆ°é˜ˆå€¼ï¼šaudit.log (8.0MB) â†’ è§¦å‘è½®è½¬

è½®è½¬è¿‡ç¨‹ï¼š
Step 1: audit.log.4 â†’ åˆ é™¤ï¼ˆè¶…è¿‡ä¿ç•™æ•°é‡ï¼‰
Step 2: audit.log.3 â†’ audit.log.4
Step 3: audit.log.2 â†’ audit.log.3  
Step 4: audit.log.1 â†’ audit.log.2
Step 5: audit.log â†’ audit.log.1
Step 6: åˆ›å»ºæ–°çš„ç©ºaudit.log

ç»“æœçŠ¶æ€ï¼š
audit.log     (æ–°æ–‡ä»¶ï¼Œ0KB)
audit.log.1   (æœ€æ–°çš„å®Œæ•´æ—¥å¿—ï¼Œ8MB)
audit.log.2   (è¾ƒæ—§çš„æ—¥å¿—ï¼Œ8MB)
...
```

### 5.2 è½®è½¬å‚æ•°è°ƒä¼˜


**ğŸ¯ å‚æ•°é€‰æ‹©æŒ‡å—**ï¼š

```
æ ¹æ®ç³»ç»Ÿç‰¹ç‚¹é€‰æ‹©å‚æ•°ï¼š

é«˜é¢‘æ“ä½œç³»ç»Ÿï¼ˆæ•°æ®åº“æœåŠ¡å™¨ï¼‰ï¼š
max_log_file = 50MB      # è¾ƒå¤§æ–‡ä»¶é¿å…é¢‘ç¹è½®è½¬
num_logs = 10            # ä¿ç•™æ›´å¤šå†å²è®°å½•

ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿï¼š
max_log_file = 20MB      # å¹³è¡¡æ€§èƒ½å’Œç®¡ç†ä¾¿åˆ©
num_logs = 5             # é€‚ä¸­çš„ä¿ç•™æ•°é‡

èµ„æºå—é™ç³»ç»Ÿï¼š
max_log_file = 10MB      # è¾ƒå°æ–‡ä»¶èŠ‚çœç©ºé—´
num_logs = 3             # æœ€å°ä¿ç•™æ•°é‡
```

### 5.3 æ‰‹åŠ¨è½®è½¬æ“ä½œ


**å¼ºåˆ¶è½®è½¬å‘½ä»¤**ï¼š
```bash
# æ‰‹åŠ¨è§¦å‘æ—¥å¿—è½®è½¬
sudo kill -USR1 $(pidof auditd)

# æˆ–ä½¿ç”¨serviceå‘½ä»¤
sudo service auditd rotate

# æ£€æŸ¥è½®è½¬ç»“æœ
ls -lh /var/log/audit/
```

### 5.4 è½®è½¬æ•…éšœæ’é™¤


**ğŸ” å¸¸è§é—®é¢˜ä¸è§£å†³**ï¼š

```
é—®é¢˜1ï¼šæ—¥å¿—æ–‡ä»¶ä¸è½®è½¬
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥max_log_fileè®¾ç½®æ˜¯å¦è¿‡å¤§
2. ç¡®è®¤auditdè¿›ç¨‹æ­£åœ¨è¿è¡Œ
3. æŸ¥çœ‹/var/log/messagesä¸­çš„é”™è¯¯ä¿¡æ¯

é—®é¢˜2ï¼šè½®è½¬åæ—¥å¿—ä¸¢å¤±
åŸå› åˆ†æï¼š
â€¢ num_logsè®¾ç½®è¿‡å°
â€¢ ç£ç›˜ç©ºé—´ä¸è¶³å¯¼è‡´è½®è½¬å¤±è´¥
â€¢ æƒé™é—®é¢˜æ— æ³•åˆ›å»ºæ–°æ–‡ä»¶
```

---

## 6. ğŸ’¾ ç£ç›˜ç©ºé—´ç®¡ç†ç­–ç•¥


### 6.1 ç©ºé—´ç›‘æ§æœºåˆ¶


**ğŸ“Š ç›‘æ§å±‚çº§è¯´æ˜**ï¼š
```
auditdç£ç›˜ç©ºé—´ç›‘æ§ä¸‰çº§é¢„è­¦ï¼š

Level 1: space_left (æ­£å¸¸é¢„è­¦)
â”œâ”€ è§¦å‘æ¡ä»¶ï¼šå‰©ä½™ç©ºé—´ < space_leftå€¼
â”œâ”€ é»˜è®¤åŠ¨ä½œï¼šSYSLOG (è®°å½•ç³»ç»Ÿæ—¥å¿—)
â””â”€ å½±å“ç¨‹åº¦ï¼šä»…æé†’ï¼Œä¸å½±å“å®¡è®¡

Level 2: admin_space_left (ç®¡ç†å‘˜é¢„è­¦)  
â”œâ”€ è§¦å‘æ¡ä»¶ï¼šå‰©ä½™ç©ºé—´ < admin_space_leftå€¼
â”œâ”€ é»˜è®¤åŠ¨ä½œï¼šSUSPEND (æš‚åœå®¡è®¡)
â””â”€ å½±å“ç¨‹åº¦ï¼šåœæ­¢è®°å½•æ–°çš„å®¡è®¡äº‹ä»¶

Level 3: disk_full (ç£ç›˜æ»¡)
â”œâ”€ è§¦å‘æ¡ä»¶ï¼šç£ç›˜ç©ºé—´è€—å°½
â”œâ”€ é»˜è®¤åŠ¨ä½œï¼šSUSPEND (æš‚åœå®¡è®¡)
â””â”€ å½±å“ç¨‹åº¦ï¼šç³»ç»Ÿå¯èƒ½å—åˆ°å½±å“
```

### 6.2 å¤„ç†åŠ¨ä½œç±»å‹


**ğŸ”§ å¯ç”¨çš„å¤„ç†åŠ¨ä½œ**ï¼š

| åŠ¨ä½œç±»å‹ | **æ‰§è¡Œæ•ˆæœ** | **é€‚ç”¨åœºæ™¯** | **å®‰å…¨çº§åˆ«** |
|---------|-------------|-------------|-------------|
| `IGNORE` | `å¿½ç•¥ï¼Œç»§ç»­è¿è¡Œ` | `æµ‹è¯•ç¯å¢ƒ` | `â­` |
| `SYSLOG` | `è®°å½•ç³»ç»Ÿæ—¥å¿—` | `ä¸€èˆ¬é¢„è­¦` | `â­â­` |
| `EMAIL` | `å‘é€é‚®ä»¶é€šçŸ¥` | `é‡è¦ç³»ç»Ÿ` | `â­â­â­` |
| `SUSPEND` | `æš‚åœå®¡è®¡æœåŠ¡` | `åˆè§„è¦æ±‚ä¸¥æ ¼` | `â­â­â­â­` |
| `HALT` | `ç³»ç»Ÿåœæœº` | `é«˜å®‰å…¨è¦æ±‚` | `â­â­â­â­â­` |

### 6.3 ç©ºé—´ç®¡ç†é…ç½®ç¤ºä¾‹


**ğŸ“‹ æ¨èé…ç½®æ¨¡æ¿**ï¼š
```bash
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
space_left = 500               # 500MBé¢„è­¦ï¼ˆæ ¹æ®æ—¥å¿—äº§ç”Ÿé€Ÿåº¦è°ƒæ•´ï¼‰
space_left_action = EMAIL     # é‚®ä»¶é€šçŸ¥ç®¡ç†å‘˜

admin_space_left = 200         # 200MBä¸¥é‡é¢„è­¦
admin_space_left_action = SUSPEND  # æš‚åœå®¡è®¡ä¿æŠ¤ç³»ç»Ÿ

disk_full_action = SUSPEND     # ç£ç›˜æ»¡æ—¶æš‚åœ
disk_error_action = SUSPEND    # ç£ç›˜é”™è¯¯æ—¶æš‚åœ

# å¼€å‘ç¯å¢ƒé…ç½®
space_left = 100
space_left_action = SYSLOG     # ä»…è®°å½•æ—¥å¿—ï¼Œä¸å½±å“å¼€å‘

admin_space_left = 50
admin_space_left_action = IGNORE   # å¿½ç•¥ï¼Œé¿å…ä¸­æ–­å¼€å‘
```

### 6.4 ç©ºé—´æ¸…ç†ç­–ç•¥


**ğŸ§¹ æ—¥å¿—æ¸…ç†æ–¹æ³•**ï¼š
```bash
# æ–¹æ³•1ï¼šè°ƒæ•´ä¿ç•™ç­–ç•¥ï¼ˆæ¨èï¼‰
# ä¿®æ”¹auditd.confä¸­çš„num_logså‚æ•°

# æ–¹æ³•2ï¼šæ‰‹åŠ¨æ¸…ç†æ—§æ—¥å¿—
sudo find /var/log/audit -name "audit.log.*" -mtime +30 -delete

# æ–¹æ³•3ï¼šä½¿ç”¨logrotateç®¡ç†
# åˆ›å»º/etc/logrotate.d/audité…ç½®æ–‡ä»¶

# æ–¹æ³•4ï¼šå‹ç¼©æ—§æ—¥å¿—èŠ‚çœç©ºé—´
sudo gzip /var/log/audit/audit.log.2
sudo gzip /var/log/audit/audit.log.3
```

---

## 7. ğŸ”— æœåŠ¡ä¾èµ–ä¸å¼€æœºè‡ªå¯


### 7.1 auditdæœåŠ¡ä¾èµ–å…³ç³»


**ğŸ“Š æœåŠ¡ä¾èµ–å›¾**ï¼š
```
ç³»ç»Ÿå¯åŠ¨é¡ºåºï¼š

    ç³»ç»Ÿå†…æ ¸å¯åŠ¨
          â†“
    åŸºç¡€ç³»ç»ŸæœåŠ¡
          â†“
    auditd.service â†â”€â”€â”€ æ—©æœŸå¯åŠ¨ï¼ˆBefore=multi-user.targetï¼‰
          â†“
    å…¶ä»–åº”ç”¨æœåŠ¡
          â†“
    ç”¨æˆ·ç™»å½•æœåŠ¡
```

**ä¾èµ–å…³ç³»è¯´æ˜**ï¼š
- **å¯åŠ¨é¡ºåº** - auditdåœ¨å¤šæ•°æœåŠ¡ä¹‹å‰å¯åŠ¨
- **åœæ­¢é¡ºåº** - auditdåœ¨å¤šæ•°æœåŠ¡ä¹‹ååœæ­¢
- **å®‰å…¨è€ƒè™‘** - ç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½è¢«å®¡è®¡è®°å½•

### 7.2 å¼€æœºè‡ªå¯åŠ¨é…ç½®


**ğŸ”§ è‡ªå¯åŠ¨ç®¡ç†å‘½ä»¤**ï¼š
```bash
# å¯ç”¨å¼€æœºè‡ªå¯åŠ¨
sudo systemctl enable auditd

# ç¦ç”¨å¼€æœºè‡ªå¯åŠ¨
sudo systemctl disable auditd

# æŸ¥çœ‹è‡ªå¯åŠ¨çŠ¶æ€
systemctl is-enabled auditd

# æŸ¥çœ‹æ‰€æœ‰è‡ªå¯åŠ¨æœåŠ¡
systemctl list-unit-files | grep enabled
```

### 7.3 æœåŠ¡ä¼˜å…ˆçº§è°ƒæ•´


**è®¾ç½®å¯åŠ¨ä¼˜å…ˆçº§**ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡æ–‡ä»¶
cat /usr/lib/systemd/system/auditd.service

# æœåŠ¡æ–‡ä»¶å…³é”®é…ç½®
[Unit]
Description=Security Auditing Service
DefaultDependencies=no
After=local-fs.target
Before=sysinit.target
```

### 7.4 å¯åŠ¨æ•…éšœæ’é™¤


**ğŸ” å¸¸è§å¯åŠ¨é—®é¢˜**ï¼š

```
é—®é¢˜1ï¼šauditdå¯åŠ¨å¤±è´¥
æ£€æŸ¥æ­¥éª¤ï¼š
1. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼šjournalctl -u auditd
2. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•ï¼šauditd -t
3. ç¡®è®¤ç£ç›˜ç©ºé—´å……è¶³

é—®é¢˜2ï¼šæœåŠ¡ä¾èµ–å†²çª
è§£å†³æ–¹æ³•ï¼š
1. æ£€æŸ¥æœåŠ¡é¡ºåºï¼šsystemctl list-dependencies auditd
2. è°ƒæ•´æœåŠ¡é…ç½®ä¸­çš„After/Beforeå‚æ•°
3. é‡æ–°åŠ è½½systemdé…ç½®ï¼šsystemctl daemon-reload
```

**å¯åŠ¨çŠ¶æ€æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# auditdçŠ¶æ€æ£€æŸ¥è„šæœ¬

echo "=== auditdæœåŠ¡çŠ¶æ€æ£€æŸ¥ ==="
echo "æœåŠ¡çŠ¶æ€: $(systemctl is-active auditd)"
echo "è‡ªå¯çŠ¶æ€: $(systemctl is-enabled auditd)"
echo "è¿›ç¨‹ID: $(pidof auditd)"
echo "é…ç½®æ–‡ä»¶: $(test -f /etc/audit/auditd.conf && echo "å­˜åœ¨" || echo "ç¼ºå¤±")"
echo "æ—¥å¿—ç›®å½•: $(test -d /var/log/audit && echo "å­˜åœ¨" || echo "ç¼ºå¤±")"
echo "ç£ç›˜ç©ºé—´: $(df -h /var/log/audit | tail -1 | awk '{print $4}') å¯ç”¨"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ auditdæœ¬è´¨ï¼šLinuxç³»ç»Ÿçš„æ“ä½œè®°å½•å’Œå®‰å…¨ç›‘æ§æœåŠ¡
ğŸ”¸ æ ¸å¿ƒç»„ä»¶ï¼šauditè½¯ä»¶åŒ… + auditdå®ˆæŠ¤è¿›ç¨‹ + é…ç½®æ–‡ä»¶
ğŸ”¸ æœåŠ¡ç®¡ç†ï¼šsystemctlæ§åˆ¶ï¼Œç‰¹æ®Šçš„é‡è½½æ–¹å¼
ğŸ”¸ é…ç½®æ–‡ä»¶ï¼š/etc/audit/auditd.confæ§åˆ¶æœåŠ¡è¡Œä¸º
ğŸ”¸ æ—¥å¿—è½®è½¬ï¼šè‡ªåŠ¨ç®¡ç†æ—¥å¿—æ–‡ä»¶å¤§å°å’Œæ•°é‡
ğŸ”¸ ç©ºé—´ç®¡ç†ï¼šå¤šçº§é¢„è­¦å’Œå¤„ç†ç­–ç•¥
ğŸ”¸ å¼€æœºè‡ªå¯ï¼šé»˜è®¤å¯ç”¨ï¼Œä¼˜å…ˆçº§è¾ƒé«˜
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ auditdçš„ç‹¬ç‰¹æ€§**
```
ä¸æ™®é€šæœåŠ¡çš„åŒºåˆ«ï¼š
â€¢ ç›´æ¥ä¸å†…æ ¸é€šä¿¡ï¼Œé‡è½½æ–¹å¼ç‰¹æ®Š
â€¢ å¯åŠ¨ä¼˜å…ˆçº§é«˜ï¼Œç¡®ä¿å®¡è®¡å®Œæ•´æ€§
â€¢ å¯¹ç£ç›˜ç©ºé—´æ•æ„Ÿï¼Œéœ€è¦ç©ºé—´ç®¡ç†ç­–ç•¥
â€¢ æ—¥å¿—æ ¼å¼ç‰¹æ®Šï¼Œéœ€è¦ä¸“é—¨çš„åˆ†æå·¥å…·
```

**ğŸ”¹ é…ç½®è°ƒä¼˜åŸåˆ™**
```
å¹³è¡¡è€ƒè™‘å› ç´ ï¼š
â€¢ å®‰å…¨æ€§ vs æ€§èƒ½ï¼šå®¡è®¡è¯¦ç»†ç¨‹åº¦çš„æƒè¡¡
â€¢ å­˜å‚¨ vs ä¿ç•™ï¼šæ—¥å¿—å¤§å°å’Œä¿ç•™æ—¶é—´çš„å¹³è¡¡  
â€¢ å¯ç”¨æ€§ vs åˆè§„ï¼šæœåŠ¡è¿ç»­æ€§å’Œå®¡è®¡å®Œæ•´æ€§çš„é€‰æ‹©
```

### 8.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯**ï¼š
- **å®‰å…¨åˆè§„** - æ»¡è¶³ç­‰ä¿ã€ISO27001ç­‰æ ‡å‡†è¦æ±‚
- **æ•…éšœæ’æŸ¥** - è¿½è¸ªç³»ç»Ÿå¼‚å¸¸å’Œå®‰å…¨äº‹ä»¶
- **è¿ç»´å®¡è®¡** - è®°å½•ç®¡ç†å‘˜æ“ä½œï¼Œè´£ä»»è¿½æº¯
- **å…¥ä¾µæ£€æµ‹** - å‘ç°å¼‚å¸¸ç™»å½•å’Œå¯ç–‘æ“ä½œ

**ğŸ”§ æœ€ä½³å®è·µå»ºè®®**ï¼š
```
å®‰è£…é…ç½®ï¼š
âœ… ç¡®ä¿auditå’Œaudit-libséƒ½å®‰è£…
âœ… æ ¹æ®ç£ç›˜ç©ºé—´åˆç†è®¾ç½®æ—¥å¿—è½®è½¬
âœ… é…ç½®ç£ç›˜ç©ºé—´é¢„è­¦æœºåˆ¶
âœ… å¯ç”¨å¼€æœºè‡ªå¯åŠ¨

è¿ç»´ç®¡ç†ï¼š
âœ… å®šæœŸæ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
âœ… ç›‘æ§æ—¥å¿—æ–‡ä»¶å¤§å°å¢é•¿
âœ… å»ºç«‹æ—¥å¿—å¤‡ä»½å’Œå½’æ¡£ç­–ç•¥
âœ… å®šæœŸæµ‹è¯•é…ç½®ä¿®æ”¹å’ŒæœåŠ¡é‡å¯
```

### 8.4 å¸¸è§é—®é¢˜é¢„é˜²


**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
```
é…ç½®ä¿®æ”¹ï¼š
â€¢ ä¿®æ”¹é…ç½®å‰åŠ¡å¿…å¤‡ä»½
â€¢ æµ‹è¯•ç¯å¢ƒéªŒè¯åå†åº”ç”¨åˆ°ç”Ÿäº§
â€¢ é‡å¯æœåŠ¡æ—¶æ³¨æ„ä¸šåŠ¡å½±å“

ç£ç›˜ç®¡ç†ï¼š
â€¢ é¢„ç•™è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
â€¢ è®¾ç½®åˆç†çš„é¢„è­¦é˜ˆå€¼
â€¢ å»ºç«‹æ—¥å¿—æ¸…ç†æœºåˆ¶

æœåŠ¡ç®¡ç†ï¼š
â€¢ ä½¿ç”¨æ­£ç¡®çš„é‡è½½æ–¹å¼
â€¢ é¿å…é¢‘ç¹é‡å¯å½±å“å®¡è®¡è¿ç»­æ€§
â€¢ ç›‘æ§æœåŠ¡ä¾èµ–å…³ç³»
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- auditdæ˜¯ç³»ç»Ÿå®‰å…¨å®¡è®¡çš„æ ¸å¿ƒæœåŠ¡
- å®‰è£…ç®€å•ä½†é…ç½®éœ€è¦æ ¹æ®ç¯å¢ƒè°ƒä¼˜
- ç£ç›˜ç©ºé—´ç®¡ç†æ˜¯è¿ç»´çš„å…³é”®ç‚¹
- æœåŠ¡ç®¡ç†æœ‰ç‰¹æ®Šæ€§ï¼Œé‡è½½æ–¹å¼è¦æ³¨æ„
- å¼€æœºè‡ªå¯ç¡®ä¿å®¡è®¡çš„è¿ç»­æ€§å’Œå®Œæ•´æ€§