---
title: 13ã€åº”ç”¨å±‚æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [åº”ç”¨æ€§èƒ½ç“¶é¢ˆå®šä½æ–¹æ³•](#1-åº”ç”¨æ€§èƒ½ç“¶é¢ˆå®šä½æ–¹æ³•)
2. [æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–è¦ç‚¹](#2-æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–è¦ç‚¹)
3. [WebæœåŠ¡å™¨æ€§èƒ½è°ƒä¼˜](#3-WebæœåŠ¡å™¨æ€§èƒ½è°ƒä¼˜)
4. [ç¼“å­˜ç­–ç•¥è®¾è®¡ä¸åº”ç”¨](#4-ç¼“å­˜ç­–ç•¥è®¾è®¡ä¸åº”ç”¨)
5. [è¿æ¥æ± é…ç½®ä¼˜åŒ–](#5-è¿æ¥æ± é…ç½®ä¼˜åŒ–)
6. [å¼‚æ­¥å¤„ç†æ¨¡å¼åº”ç”¨](#6-å¼‚æ­¥å¤„ç†æ¨¡å¼åº”ç”¨)
7. [è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©](#7-è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” åº”ç”¨æ€§èƒ½ç“¶é¢ˆå®šä½æ–¹æ³•


### 1.1 ä»€ä¹ˆæ˜¯åº”ç”¨æ€§èƒ½ç“¶é¢ˆ


**é€šä¿—ç†è§£**ï¼šåº”ç”¨æ€§èƒ½ç“¶é¢ˆå°±åƒæ°´ç®¡ä¸­æœ€ç»†çš„é‚£ä¸€æ®µï¼Œå†³å®šäº†æ•´ä¸ªæ°´æµçš„é€Ÿåº¦ã€‚åœ¨åº”ç”¨ç³»ç»Ÿä¸­ï¼Œç“¶é¢ˆæ˜¯æŒ‡é™åˆ¶æ•´ä¸ªç³»ç»Ÿæ€§èƒ½å‘æŒ¥çš„é‚£ä¸ªç¯èŠ‚ã€‚

**å¸¸è§ç“¶é¢ˆä½ç½®**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ ç½‘ç»œ â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ WebæœåŠ¡å™¨ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ æ•°æ®åº“
           â†‘        â†‘           â†‘         â†‘           â†‘
         ç½‘ç»œç“¶é¢ˆ   è´Ÿè½½ç“¶é¢ˆ     CPUç“¶é¢ˆ   å†…å­˜ç“¶é¢ˆ    IOç“¶é¢ˆ
```

### 1.2 æ€§èƒ½ç“¶é¢ˆåˆ†ç±»


**ğŸ”¸ CPUå¯†é›†å‹ç“¶é¢ˆ**
- **è¡¨ç°**ï¼šCPUä½¿ç”¨ç‡æŒç»­é«˜ä½ï¼Œå“åº”æ—¶é—´é•¿
- **åŸå› **ï¼šå¤§é‡è®¡ç®—ã€å¤æ‚ç®—æ³•ã€æ— æ•ˆå¾ªç¯
- **è¯†åˆ«**ï¼š`top`å‘½ä»¤çœ‹åˆ°CPUä½¿ç”¨ç‡è¶…è¿‡80%

**ğŸ”¸ å†…å­˜ç“¶é¢ˆ**
- **è¡¨ç°**ï¼šé¢‘ç¹å†…å­˜å›æ”¶ã€å“åº”å˜æ…¢ã€OOMé”™è¯¯
- **åŸå› **ï¼šå†…å­˜æ³„æ¼ã€ç¼“å­˜è¿‡å¤§ã€å¹¶å‘è¿‡é«˜
- **è¯†åˆ«**ï¼š`free -h`çœ‹åˆ°å¯ç”¨å†…å­˜ä¸è¶³

**ğŸ”¸ IOç“¶é¢ˆ**
- **è¡¨ç°**ï¼šç£ç›˜ç­‰å¾…æ—¶é—´é•¿ã€æ•°æ®åº“æŸ¥è¯¢æ…¢
- **åŸå› **ï¼šé¢‘ç¹ç£ç›˜è¯»å†™ã€æ•°æ®åº“é”ç«äº‰
- **è¯†åˆ«**ï¼š`iostat`çœ‹åˆ°%utilæ¥è¿‘100%

**ğŸ”¸ ç½‘ç»œç“¶é¢ˆ**
- **è¡¨ç°**ï¼šç½‘ç»œå»¶è¿Ÿé«˜ã€ä¼ è¾“è¶…æ—¶
- **åŸå› **ï¼šå¸¦å®½ä¸è¶³ã€ç½‘ç»œæ‹¥å¡ã€DNSè§£ææ…¢
- **è¯†åˆ«**ï¼š`netstat`ã€`ss`æŸ¥çœ‹è¿æ¥çŠ¶æ€

### 1.3 ç“¶é¢ˆå®šä½å·¥å…·ä¸æ–¹æ³•


**ğŸ“Š ç³»ç»Ÿçº§ç›‘æ§å·¥å…·**

| å·¥å…· | **ç›‘æ§å¯¹è±¡** | **å…³é”®æŒ‡æ ‡** | **ä½¿ç”¨åœºæ™¯** |
|------|------------|-------------|-------------|
| `top/htop` | `CPUã€å†…å­˜` | `%CPUã€%MEMã€Load Average` | `å®æ—¶æ€§èƒ½ç›‘æ§` |
| `iostat` | `ç£ç›˜IO` | `%utilã€awaitã€r/sã€w/s` | `ç£ç›˜æ€§èƒ½åˆ†æ` |
| `netstat` | `ç½‘ç»œè¿æ¥` | `è¿æ¥çŠ¶æ€ã€é˜Ÿåˆ—é•¿åº¦` | `ç½‘ç»œé—®é¢˜æ’æŸ¥` |
| `vmstat` | `ç³»ç»Ÿæ•´ä½“` | `è¿è¡Œé˜Ÿåˆ—ã€å†…å­˜ã€IOã€CPU` | `ç»¼åˆæ€§èƒ½åˆ†æ` |

**ğŸ”§ åº”ç”¨çº§å®šä½æ–¹æ³•**

```bash
# 1. æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“è´Ÿè½½
uptime
# è¾“å‡ºï¼šload average: 0.50, 0.30, 0.15
# å«ä¹‰ï¼š1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå¹³å‡è´Ÿè½½

# 2. åˆ†æCPUä½¿ç”¨æƒ…å†µ
top -p $(pgrep java)  # æŸ¥çœ‹Javaåº”ç”¨CPUä½¿ç”¨
# å…³æ³¨ï¼š%CPUåˆ—ï¼Œè¶…è¿‡80%éœ€è¦å…³æ³¨

# 3. åˆ†æå†…å­˜ä½¿ç”¨
ps aux --sort=-%mem | head -10  # å†…å­˜ä½¿ç”¨æœ€é«˜çš„10ä¸ªè¿›ç¨‹
free -h  # ç³»ç»Ÿå†…å­˜çŠ¶æ€

# 4. åˆ†æIOæ€§èƒ½
iostat -x 2 5  # æ¯2ç§’è¾“å‡ºä¸€æ¬¡ï¼Œå…±5æ¬¡
# å…³æ³¨ï¼š%utilï¼ˆè®¾å¤‡ä½¿ç”¨ç‡ï¼‰ã€awaitï¼ˆå¹³å‡ç­‰å¾…æ—¶é—´ï¼‰
```

### 1.4 ç“¶é¢ˆå®šä½æµç¨‹


**ğŸ“‹ æ ‡å‡†å®šä½æµç¨‹**
```
æ­¥éª¤1ï¼šæ”¶é›†æ€§èƒ½åŸºçº¿
      â†“
æ­¥éª¤2ï¼šç›‘æ§å…³é”®æŒ‡æ ‡
      â†“  
æ­¥éª¤3ï¼šè¯†åˆ«å¼‚å¸¸æ¨¡å¼
      â†“
æ­¥éª¤4ï¼šæ·±å…¥åˆ†æç“¶é¢ˆç»„ä»¶
      â†“
æ­¥éª¤5ï¼šéªŒè¯ä¼˜åŒ–æ•ˆæœ
```

**ğŸ’¡ å®é™…å®šä½ç¤ºä¾‹**
> **åœºæ™¯**ï¼šWebåº”ç”¨å“åº”å˜æ…¢ï¼Œç”¨æˆ·æŠ•è¯‰é¡µé¢åŠ è½½æ—¶é—´è¶…è¿‡10ç§’
> 
> **å®šä½è¿‡ç¨‹**ï¼š
> 1. **ç³»ç»Ÿæ£€æŸ¥**ï¼š`top`å‘ç°CPUæ­£å¸¸ï¼Œå†…å­˜å……è¶³
> 2. **ç½‘ç»œæ£€æŸ¥**ï¼š`netstat`å‘ç°å¤§é‡ESTABLISHEDè¿æ¥
> 3. **åº”ç”¨æ£€æŸ¥**ï¼šåº”ç”¨æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“æŸ¥è¯¢è¶…æ—¶
> 4. **æ•°æ®åº“æ£€æŸ¥**ï¼šå‘ç°æ…¢æŸ¥è¯¢å’Œé”ç­‰å¾…
> 5. **ç»“è®º**ï¼šç“¶é¢ˆåœ¨æ•°æ®åº“å±‚é¢ï¼Œéœ€è¦ä¼˜åŒ–SQLå’Œç´¢å¼•

---

## 2. ğŸ—ƒï¸ æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–è¦ç‚¹


### 2.1 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–åŸºç¡€


**æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–æœ¬è´¨**ï¼šè®©æ•°æ®åº“æ›´å¿«åœ°æ‰¾åˆ°å’Œå¤„ç†æ•°æ®ï¼Œå‡å°‘ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€‚

**ä¼˜åŒ–å±‚æ¬¡ç»“æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SQLæŸ¥è¯¢ä¼˜åŒ–    â”‚ â† æœ€ç›´æ¥æœ‰æ•ˆçš„ä¼˜åŒ–
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç´¢å¼•è®¾è®¡ä¼˜åŒ–   â”‚ â† æå‡æŸ¥è¯¢é€Ÿåº¦çš„å…³é”®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®åº“é…ç½®ä¼˜åŒ– â”‚ â† å……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç¡¬ä»¶èµ„æºä¼˜åŒ–   â”‚ â† åŸºç¡€è®¾æ–½æ”¯æ’‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 SQLæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ æŸ¥è¯¢è¯­å¥ä¼˜åŒ–åŸåˆ™**

**é¿å…å…¨è¡¨æ‰«æ**
```sql
-- âŒ ä½æ•ˆæŸ¥è¯¢ï¼ˆå…¨è¡¨æ‰«æï¼‰
SELECT * FROM users WHERE name LIKE '%å¼ %';

-- âœ… é«˜æ•ˆæŸ¥è¯¢ï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰
SELECT id, name, email FROM users WHERE name = 'å¼ ä¸‰';
```

**åˆç†ä½¿ç”¨ç´¢å¼•**
```sql
-- âŒ ä¸èµ°ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM orders WHERE YEAR(create_time) = 2024;

-- âœ… èµ°ç´¢å¼•çš„æŸ¥è¯¢  
SELECT * FROM orders WHERE create_time >= '2024-01-01' 
  AND create_time < '2025-01-01';
```

**ä¼˜åŒ–JOINæ“ä½œ**
```sql
-- âŒ ç¬›å¡å°”ç§¯ï¼ˆæ€§èƒ½å¾ˆå·®ï¼‰
SELECT * FROM users, orders WHERE users.id = orders.user_id;

-- âœ… æ˜ç¡®çš„JOINï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
SELECT u.name, o.total FROM users u 
INNER JOIN orders o ON u.id = o.user_id;
```

### 2.3 ç´¢å¼•è®¾è®¡ä¸ä¼˜åŒ–


**ğŸ”¸ ç´¢å¼•ç±»å‹é€‰æ‹©**

| ç´¢å¼•ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** |
|---------|------------|---------|---------|
| `ä¸»é”®ç´¢å¼•` | `å”¯ä¸€æ ‡è¯†è®°å½•` | `æŸ¥è¯¢æœ€å¿«ã€å”¯ä¸€æ€§ä¿è¯` | `åªèƒ½æœ‰ä¸€ä¸ª` |
| `å”¯ä¸€ç´¢å¼•` | `å”¯ä¸€æ€§çº¦æŸå­—æ®µ` | `ä¿è¯æ•°æ®å”¯ä¸€æ€§` | `æ’å…¥æ€§èƒ½ç¨å·®` |
| `æ™®é€šç´¢å¼•` | `é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µ` | `æå‡æŸ¥è¯¢é€Ÿåº¦` | `å ç”¨å­˜å‚¨ç©ºé—´` |
| `ç»„åˆç´¢å¼•` | `å¤šæ¡ä»¶æŸ¥è¯¢` | `è¦†ç›–å¤šç§æŸ¥è¯¢åœºæ™¯` | `ç»´æŠ¤æˆæœ¬é«˜` |

**ğŸ”§ ç´¢å¼•ä¼˜åŒ–å®è·µ**

```bash
# æŸ¥çœ‹è¡¨çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ
mysql> SHOW INDEX FROM users;

# åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’
mysql> EXPLAIN SELECT * FROM users WHERE email = 'test@example.com';
```

**æœ€å·¦å‰ç¼€åŸåˆ™**ï¼š
```sql
-- åˆ›å»ºç»„åˆç´¢å¼•
CREATE INDEX idx_name_age_city ON users(name, age, city);

-- âœ… èƒ½ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM users WHERE name = 'å¼ ä¸‰';                    -- ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE name = 'å¼ ä¸‰' AND age = 25;       -- ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE name = 'å¼ ä¸‰' AND city = 'åŒ—äº¬';   -- éƒ¨åˆ†ä½¿ç”¨ç´¢å¼•

-- âŒ ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM users WHERE age = 25;                        -- ä¸ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE city = 'åŒ—äº¬';                   -- ä¸ä½¿ç”¨ç´¢å¼•
```

### 2.4 æ•°æ®åº“è¿æ¥ä¼˜åŒ–


**ğŸ”¸ è¿æ¥æ± é…ç½®è¦ç‚¹**

```bash
# MySQLé…ç½®ç¤ºä¾‹ (my.cnf)
[mysqld]
# æœ€å¤§è¿æ¥æ•°
max_connections = 500

# è¿æ¥è¶…æ—¶æ—¶é—´
wait_timeout = 300
interactive_timeout = 300

# æŸ¥è¯¢ç¼“å­˜
query_cache_size = 128M
query_cache_type = 1

# InnoDBç¼“å†²æ± å¤§å°ï¼ˆé‡è¦ï¼ï¼‰
innodb_buffer_pool_size = 2G
```

**è¿æ¥æ•°ç›‘æ§**ï¼š
```bash
# æŸ¥çœ‹å½“å‰è¿æ¥æ•°
mysql> SHOW STATUS LIKE 'Threads_connected';

# æŸ¥çœ‹è¿æ¥çš„è¯¦ç»†ä¿¡æ¯
mysql> SHOW PROCESSLIST;

# æŸ¥çœ‹è¿æ¥æ•°å†å²æœ€å¤§å€¼
mysql> SHOW STATUS LIKE 'Max_used_connections';
```

---

## 3. ğŸŒ WebæœåŠ¡å™¨æ€§èƒ½è°ƒä¼˜


### 3.1 WebæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°


**WebæœåŠ¡å™¨ä½œç”¨**ï¼šWebæœåŠ¡å™¨æ˜¯ç”¨æˆ·è¯·æ±‚å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„æ¡¥æ¢ï¼Œè´Ÿè´£å¤„ç†HTTPè¯·æ±‚ã€é™æ€æ–‡ä»¶æœåŠ¡ã€è´Ÿè½½åˆ†å‘ç­‰å·¥ä½œã€‚

**æ€§èƒ½å½±å“å› ç´ **ï¼š
```
å¹¶å‘è¿æ¥æ•° â†’ å†³å®šèƒ½åŒæ—¶æœåŠ¡å¤šå°‘ç”¨æˆ·
è¯·æ±‚å¤„ç†é€Ÿåº¦ â†’ å½±å“ç”¨æˆ·ä½“éªŒ
èµ„æºåˆ©ç”¨ç‡ â†’ å½±å“æœåŠ¡å™¨æˆæœ¬æ•ˆç›Š
ç¨³å®šæ€§ â†’ å†³å®šæœåŠ¡å¯ç”¨æ€§
```

### 3.2 Nginxæ€§èƒ½è°ƒä¼˜


**ğŸ”¸ æ ¸å¿ƒé…ç½®ä¼˜åŒ–**

```nginx
# nginx.conf ä¸»è¦æ€§èƒ½é…ç½®
user nginx;
worker_processes auto;  # è‡ªåŠ¨è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°

events {
    # æ¯ä¸ªworkerè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°
    worker_connections 1024;
    
    # ä½¿ç”¨epolläº‹ä»¶æ¨¡å‹ï¼ˆLinuxä¸‹æ¨èï¼‰
    use epoll;
    
    # å…è®¸å°½å¯èƒ½å¤šçš„è¿æ¥åŒæ—¶å¤„ç†
    multi_accept on;
}

http {
    # å¼€å¯gzipå‹ç¼©
    gzip on;
    gzip_min_length 1k;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript;
    
    # ç¼“å­˜é…ç½®
    open_file_cache max=1000 inactive=20s;
    open_file_cache_valid 30s;
    
    # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶
    client_header_timeout 10s;
    client_body_timeout 10s;
    send_timeout 10s;
}
```

**ğŸ”§ é™æ€èµ„æºä¼˜åŒ–**

```nginx
server {
    listen 80;
    server_name example.com;
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|css|js)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
        
        # å¼€å¯gzipå‹ç¼©
        gzip_static on;
    }
    
    # é˜²æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
        return 404;
    }
}
```

### 3.3 Apacheæ€§èƒ½è°ƒä¼˜


**ğŸ”¸ MPMæ¨¡å—é€‰æ‹©**

```apache
# preforkæ¨¡å¼ï¼ˆç¨³å®šä½†å¹¶å‘æ€§èƒ½ä¸€èˆ¬ï¼‰
<IfModule mpm_prefork_module>
    StartServers 8
    MinSpareServers 5
    MaxSpareServers 20
    MaxRequestWorkers 256
    MaxConnectionsPerChild 1000
</IfModule>

# workeræ¨¡å¼ï¼ˆæ¨èï¼Œæ€§èƒ½å¥½ï¼‰
<IfModule mpm_worker_module>
    StartServers 3
    MinSpareThreads 75
    MaxSpareThreads 250
    ThreadsPerChild 25
    MaxRequestWorkers 400
    MaxConnectionsPerChild 1000
</IfModule>
```

### 3.4 æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜


**ğŸ“Š å…³é”®æ€§èƒ½æŒ‡æ ‡**

```bash
# ç›‘æ§nginxçŠ¶æ€
curl http://localhost/nginx_status
# è¾“å‡ºï¼š
# Active connections: 291 
# server accepts handled requests
#  16630948 16630948 31070465 
# Reading: 6 Writing: 179 Waiting: 106

# è§£é‡Šï¼š
# Active connections: å½“å‰æ´»è·ƒè¿æ¥æ•°
# Reading: æ­£åœ¨è¯»å–è¯·æ±‚å¤´çš„è¿æ¥æ•°
# Writing: æ­£åœ¨å‘å®¢æˆ·ç«¯å†™å“åº”çš„è¿æ¥æ•°
# Waiting: ä¿æŒè¿æ¥ç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚çš„è¿æ¥æ•°
```

**ğŸ”§ æ€§èƒ½æµ‹è¯•å·¥å…·**

```bash
# ä½¿ç”¨abè¿›è¡Œå‹åŠ›æµ‹è¯•
ab -n 1000 -c 10 http://localhost/
# -n: æ€»è¯·æ±‚æ•°
# -c: å¹¶å‘è¿æ¥æ•°

# ä½¿ç”¨wrkè¿›è¡Œæ›´å¼ºå¤§çš„å‹åŠ›æµ‹è¯•
wrk -t12 -c400 -d30s http://localhost/
# -t: çº¿ç¨‹æ•°
# -c: å¹¶å‘è¿æ¥æ•°  
# -d: æµ‹è¯•æŒç»­æ—¶é—´
```

---

## 4. ğŸ—‚ï¸ ç¼“å­˜ç­–ç•¥è®¾è®¡ä¸åº”ç”¨


### 4.1 ç¼“å­˜çš„æœ¬è´¨ä¸ä½œç”¨


**ç¼“å­˜æœ¬è´¨**ï¼šç¼“å­˜å°±åƒä¸€ä¸ªä¸´æ—¶ä»“åº“ï¼ŒæŠŠç»å¸¸éœ€è¦çš„æ•°æ®æ”¾åœ¨ç¦»ä½ æœ€è¿‘ã€æœ€å®¹æ˜“æ‹¿åˆ°çš„åœ°æ–¹ï¼Œé¿å…æ¯æ¬¡éƒ½è¦è·‘å¾ˆè¿œå»å–ã€‚

**ç¼“å­˜å±‚æ¬¡ç»“æ„**ï¼š
```
æµè§ˆå™¨ç¼“å­˜ â† æœ€æ¥è¿‘ç”¨æˆ·ï¼Œé€Ÿåº¦æœ€å¿«
     â†“
CDNç¼“å­˜ â† å…¨çƒåˆ†å¸ƒï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿ
     â†“
åå‘ä»£ç†ç¼“å­˜ â† æœåŠ¡å™¨ç«¯ç¼“å­˜ï¼Œå‡è½»åç«¯å‹åŠ›
     â†“
åº”ç”¨ç¼“å­˜ â† å†…å­˜ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—
     â†“
æ•°æ®åº“ç¼“å­˜ â† å‡å°‘ç£ç›˜IO
```

### 4.2 Redisç¼“å­˜ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ RedisåŸºç¡€é…ç½®ä¼˜åŒ–**

```bash
# redis.conf å…³é”®é…ç½®
# æœ€å¤§å†…å­˜è®¾ç½®ï¼ˆé‡è¦ï¼ï¼‰
maxmemory 2gb

# å†…å­˜ä¸è¶³æ—¶çš„ç­–ç•¥
maxmemory-policy allkeys-lru

# æŒä¹…åŒ–é…ç½®
save 900 1      # 900ç§’å†…è‡³å°‘1ä¸ªkeyå˜åŒ–åˆ™ä¿å­˜
save 300 10     # 300ç§’å†…è‡³å°‘10ä¸ªkeyå˜åŒ–åˆ™ä¿å­˜
save 60 10000   # 60ç§’å†…è‡³å°‘10000ä¸ªkeyå˜åŒ–åˆ™ä¿å­˜

# ç¦ç”¨ä¸å¿…è¦çš„å‘½ä»¤
rename-command FLUSHDB ""
rename-command FLUSHALL ""
```

**ğŸ”§ ç¼“å­˜ä½¿ç”¨æ¨¡å¼**

**Cache-Asideæ¨¡å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰**ï¼š
```python
def get_user(user_id):
    # 1. å…ˆæŸ¥ç¼“å­˜
    user = redis.get(f"user:{user_id}")
    
    if user:
        return json.loads(user)  # ç¼“å­˜å‘½ä¸­
    
    # 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
    user = db.query("SELECT * FROM users WHERE id = %s", user_id)
    
    # 3. å†™å…¥ç¼“å­˜
    redis.setex(f"user:{user_id}", 3600, json.dumps(user))
    
    return user

def update_user(user_id, data):
    # 1. æ›´æ–°æ•°æ®åº“
    db.update("UPDATE users SET ... WHERE id = %s", user_id)
    
    # 2. åˆ é™¤ç¼“å­˜ï¼ˆè®©ä¸‹æ¬¡æŸ¥è¯¢æ—¶é‡æ–°åŠ è½½ï¼‰
    redis.delete(f"user:{user_id}")
```

### 4.3 ç¼“å­˜å¤±æ•ˆç­–ç•¥


**ğŸ”¸ ç¼“å­˜é›ªå´©é—®é¢˜**

**é—®é¢˜**ï¼šå¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼Œå¯¼è‡´è¯·æ±‚å…¨éƒ¨æ‰“åˆ°æ•°æ®åº“
**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
import random

def set_cache_with_random_expire(key, value, base_expire=3600):
    # åœ¨åŸºç¡€è¿‡æœŸæ—¶é—´ä¸Šå¢åŠ éšæœºæ—¶é—´ï¼ˆÂ±20%ï¼‰
    random_expire = base_expire + random.randint(-base_expire//5, base_expire//5)
    redis.setex(key, random_expire, value)
```

**ğŸ”¸ ç¼“å­˜ç©¿é€é—®é¢˜**

**é—®é¢˜**ï¼šæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜æ°¸è¿œä¸ä¼šå‘½ä¸­
**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def get_user_safe(user_id):
    user = redis.get(f"user:{user_id}")
    
    if user == "null":  # æ˜ç¡®æ ‡è®°ä¸å­˜åœ¨
        return None
        
    if user:
        return json.loads(user)
    
    user = db.query("SELECT * FROM users WHERE id = %s", user_id)
    
    if user:
        redis.setex(f"user:{user_id}", 3600, json.dumps(user))
    else:
        # å¯¹ä¸å­˜åœ¨çš„æ•°æ®ä¹Ÿç¼“å­˜ï¼Œä½†æ—¶é—´è¾ƒçŸ­
        redis.setex(f"user:{user_id}", 300, "null")
    
    return user
```

### 4.4 ç¼“å­˜æ€§èƒ½ç›‘æ§


**ğŸ“Š Redisæ€§èƒ½æŒ‡æ ‡**

```bash
# æŸ¥çœ‹Redisä¿¡æ¯
redis-cli info

# å…³é”®æŒ‡æ ‡ï¼š
# used_memory: å·²ä½¿ç”¨å†…å­˜
# keyspace_hits: ç¼“å­˜å‘½ä¸­æ¬¡æ•°
# keyspace_misses: ç¼“å­˜æœªå‘½ä¸­æ¬¡æ•°
# instantaneous_ops_per_sec: æ¯ç§’æ“ä½œæ•°

# è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡
hit_rate = keyspace_hits / (keyspace_hits + keyspace_misses) * 100%
```

**ç›‘æ§å‘½ä»¤**ï¼š
```bash
# å®æ—¶ç›‘æ§Rediså‘½ä»¤
redis-cli monitor

# æŸ¥çœ‹æ…¢æŸ¥è¯¢
redis-cli slowlog get 10

# æŸ¥çœ‹å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯
redis-cli client list
```

---

## 5. ğŸ”— è¿æ¥æ± é…ç½®ä¼˜åŒ–


### 5.1 è¿æ¥æ± çš„ä½œç”¨ä¸åŸç†


**è¿æ¥æ± æœ¬è´¨**ï¼šè¿æ¥æ± å°±åƒä¸€ä¸ªåœè½¦åœºï¼Œé¢„å…ˆå‡†å¤‡å¥½ä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥ï¼Œåº”ç”¨éœ€è¦æ—¶ç›´æ¥ä»æ± ä¸­å–ç”¨ï¼Œç”¨å®Œåå½’è¿˜ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥çš„å¼€é”€ã€‚

**æ²¡æœ‰è¿æ¥æ± çš„é—®é¢˜**ï¼š
```
åº”ç”¨è¯·æ±‚ â†’ åˆ›å»ºæ•°æ®åº“è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å…³é—­è¿æ¥
           â†‘                            â†“
        è€—æ—¶100ms                    åˆè€—æ—¶50ms
```

**ä½¿ç”¨è¿æ¥æ± çš„ä¼˜åŠ¿**ï¼š
```
åº”ç”¨è¯·æ±‚ â†’ ä»æ± ä¸­è·å–è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å½’è¿˜è¿æ¥åˆ°æ± 
           â†‘                        â†“  
        è€—æ—¶1ms                   è€—æ—¶1ms
```

### 5.2 æ•°æ®åº“è¿æ¥æ± é…ç½®


**ğŸ”¸ HikariCPè¿æ¥æ± é…ç½®ï¼ˆJavaï¼‰**

```properties
# è¿æ¥æ± åŸºç¡€é…ç½®
spring.datasource.hikari.minimum-idle=10          # æœ€å°ç©ºé—²è¿æ¥æ•°
spring.datasource.hikari.maximum-pool-size=20     # æœ€å¤§è¿æ¥æ•°
spring.datasource.hikari.idle-timeout=300000      # ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´(5åˆ†é’Ÿ)
spring.datasource.hikari.max-lifetime=1200000     # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´(20åˆ†é’Ÿ)
spring.datasource.hikari.connection-timeout=20000 # è¿æ¥è¶…æ—¶æ—¶é—´(20ç§’)

# è¿æ¥æ£€æµ‹é…ç½®
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.validation-timeout=5000   # è¿æ¥éªŒè¯è¶…æ—¶æ—¶é—´
```

**ğŸ”§ è¿æ¥æ± å¤§å°è®¡ç®—å…¬å¼**

```
è¿æ¥æ± å¤§å° = ((æ ¸å¿ƒæ•° Ã— 2) + ç£ç›˜æ•°)

ä¾‹å¦‚ï¼š
- 4æ ¸CPUï¼Œ2å—ç£ç›˜
- è¿æ¥æ± å¤§å° = (4 Ã— 2) + 2 = 10

å®é™…åº”ç”¨ä¸­è¿˜è¦è€ƒè™‘ï¼š
- åº”ç”¨å¹¶å‘é‡
- æ•°æ®åº“æœåŠ¡å™¨æ€§èƒ½
- ç½‘ç»œå»¶è¿Ÿ
- ä¸šåŠ¡å¤æ‚åº¦
```

### 5.3 WebæœåŠ¡å™¨è¿æ¥æ± 


**ğŸ”¸ Tomcatè¿æ¥æ± é…ç½®**

```xml
<!-- server.xml -->
<Connector port="8080" 
           protocol="HTTP/1.1"
           maxThreads="200"          <!-- æœ€å¤§çº¿ç¨‹æ•° -->
           minSpareThreads="10"      <!-- æœ€å°ç©ºé—²çº¿ç¨‹æ•° -->
           maxSpareThreads="100"     <!-- æœ€å¤§ç©ºé—²çº¿ç¨‹æ•° -->
           acceptCount="100"         <!-- ç­‰å¾…é˜Ÿåˆ—é•¿åº¦ -->
           connectionTimeout="20000" <!-- è¿æ¥è¶…æ—¶æ—¶é—´ -->
           />
```

**çº¿ç¨‹æ± ç›‘æ§**ï¼š
```bash
# æŸ¥çœ‹Tomcatçº¿ç¨‹çŠ¶æ€
curl http://localhost:8080/manager/status

# ä½¿ç”¨jstackæŸ¥çœ‹Javaçº¿ç¨‹
jstack <tomcat_pid> | grep "http-nio"
```

### 5.4 è¿æ¥æ± è°ƒä¼˜ç­–ç•¥


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**

| æŒ‡æ ‡ | **æ­£å¸¸èŒƒå›´** | **å¼‚å¸¸è¡¨ç°** | **è°ƒä¼˜å»ºè®®** |
|------|------------|-------------|-------------|
| `è¿æ¥ä½¿ç”¨ç‡` | `60-80%` | `>90%æŒç»­é«˜ä½` | `å¢åŠ è¿æ¥æ± å¤§å°` |
| `ç­‰å¾…æ—¶é—´` | `<100ms` | `>1sé¢‘ç¹ç­‰å¾…` | `ä¼˜åŒ–SQLæˆ–å¢åŠ è¿æ¥` |
| `è¶…æ—¶è¿æ¥æ•°` | `<1%` | `>5%è¶…æ—¶ä¸¥é‡` | `æ£€æŸ¥ç½‘ç»œå’Œæ•°æ®åº“æ€§èƒ½` |
| `ç©ºé—²è¿æ¥æ•°` | `10-30%` | `è¿‡å¤šæˆ–è¿‡å°‘` | `è°ƒæ•´æœ€å°/æœ€å¤§è¿æ¥æ•°` |

**ğŸ”§ è°ƒä¼˜å®è·µ**

```python
# Pythonè¿æ¥æ± é…ç½®ç¤ºä¾‹
import pymysql
from dbutils.pooled_db import PooledDB

# åˆ›å»ºè¿æ¥æ± 
pool = PooledDB(
    creator=pymysql,           # æ•°æ®åº“æ¨¡å—
    maxconnections=20,         # æœ€å¤§è¿æ¥æ•°
    mincached=5,              # æœ€å°ç¼“å­˜è¿æ¥æ•°
    maxcached=10,             # æœ€å¤§ç¼“å­˜è¿æ¥æ•°
    blocking=True,            # è¿æ¥ç”¨å®Œæ—¶æ˜¯å¦é˜»å¡ç­‰å¾…
    maxusage=1000,           # å•ä¸ªè¿æ¥æœ€å¤§ä½¿ç”¨æ¬¡æ•°
    setsession=['SET AUTOCOMMIT = 1'],  # è¿æ¥å‰æ‰§è¡Œçš„å‘½ä»¤
    host='localhost',
    user='root',
    password='password',
    database='test',
    charset='utf8'
)

# ä½¿ç”¨è¿æ¥æ± 
def query_user(user_id):
    conn = pool.connection()  # ä»æ± ä¸­è·å–è¿æ¥
    try:
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))
        return cursor.fetchone()
    finally:
        conn.close()  # å½’è¿˜è¿æ¥åˆ°æ± ä¸­
```

---

## 6. âš¡ å¼‚æ­¥å¤„ç†æ¨¡å¼åº”ç”¨


### 6.1 å¼‚æ­¥å¤„ç†çš„æ ¸å¿ƒæ¦‚å¿µ


**åŒæ­¥å¤„ç†é—®é¢˜**ï¼šå°±åƒæ’é˜Ÿä¹°å’–å•¡ï¼Œå‰é¢çš„äººä¸ä¹°å®Œï¼Œåé¢çš„äººåªèƒ½ç­‰ç€ï¼Œæ•ˆç‡å¾ˆä½ã€‚

**å¼‚æ­¥å¤„ç†ä¼˜åŠ¿**ï¼šå°±åƒé¤å…çš„å«å·ç³»ç»Ÿï¼Œç‚¹å®Œé¤æ‹¿ä¸ªå·å°±å¯ä»¥åšå…¶ä»–äº‹ï¼Œé¤åšå¥½äº†å†æ¥å–ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚

**å¤„ç†æ¨¡å¼å¯¹æ¯”**ï¼š
```
åŒæ­¥å¤„ç†ï¼š
è¯·æ±‚A â†’ å¤„ç†A â†’ è¿”å›ç»“æœA â†’ è¯·æ±‚B â†’ å¤„ç†B â†’ è¿”å›ç»“æœB
               â†‘_____________â†“
              é˜»å¡æ—¶é—´é•¿

å¼‚æ­¥å¤„ç†ï¼š
è¯·æ±‚A â†’ æäº¤ä»»åŠ¡A â†’ ç«‹å³è¿”å› â†’ è¯·æ±‚B â†’ æäº¤ä»»åŠ¡B â†’ ç«‹å³è¿”å›
              â†“                       â†“
          åå°å¤„ç†A                 åå°å¤„ç†B
```

### 6.2 æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†


**ğŸ”¸ Redisé˜Ÿåˆ—å®ç°**

```python
import redis
import json
import time

redis_client = redis.Redis(host='localhost', port=6379, db=0)

# ç”Ÿäº§è€…ï¼šå‘é€ä»»åŠ¡åˆ°é˜Ÿåˆ—
def send_email_task(email, subject, content):
    task = {
        'email': email,
        'subject': subject, 
        'content': content,
        'timestamp': time.time()
    }
    
    # å°†ä»»åŠ¡æ¨å…¥é˜Ÿåˆ—
    redis_client.lpush('email_queue', json.dumps(task))
    print(f"é‚®ä»¶ä»»åŠ¡å·²æäº¤ï¼š{email}")

# æ¶ˆè´¹è€…ï¼šä»é˜Ÿåˆ—è·å–ä»»åŠ¡å¹¶å¤„ç†
def process_email_queue():
    while True:
        # ä»é˜Ÿåˆ—ä¸­å¼¹å‡ºä»»åŠ¡ï¼ˆé˜»å¡å¼ï¼‰
        task_data = redis_client.brpop('email_queue', timeout=5)
        
        if task_data:
            task = json.loads(task_data[1])
            
            try:
                # æ¨¡æ‹Ÿå‘é€é‚®ä»¶
                send_email(task['email'], task['subject'], task['content'])
                print(f"é‚®ä»¶å‘é€æˆåŠŸï¼š{task['email']}")
                
            except Exception as e:
                print(f"é‚®ä»¶å‘é€å¤±è´¥ï¼š{e}")
                # å¤±è´¥çš„ä»»åŠ¡å¯ä»¥é‡æ–°å…¥é˜Ÿæˆ–è®°å½•åˆ°å¤±è´¥é˜Ÿåˆ—
                redis_client.lpush('email_failed_queue', json.dumps(task))

def send_email(email, subject, content):
    # å®é™…çš„é‚®ä»¶å‘é€é€»è¾‘
    time.sleep(2)  # æ¨¡æ‹Ÿé‚®ä»¶å‘é€è€—æ—¶
```

### 6.3 å¼‚æ­¥IOå¤„ç†


**ğŸ”¸ Python asyncioç¤ºä¾‹**

```python
import asyncio
import aiohttp
import time

# åŒæ­¥æ–¹å¼è·å–å¤šä¸ªURLï¼ˆæ•ˆç‡ä½ï¼‰
def fetch_urls_sync(urls):
    results = []
    for url in urls:
        response = requests.get(url)
        results.append(response.text)
    return results

# å¼‚æ­¥æ–¹å¼è·å–å¤šä¸ªURLï¼ˆæ•ˆç‡é«˜ï¼‰
async def fetch_url_async(session, url):
    async with session.get(url) as response:
        return await response.text()

async def fetch_urls_async(urls):
    async with aiohttp.ClientSession() as session:
        tasks = [fetch_url_async(session, url) for url in urls]
        results = await asyncio.gather(*tasks)
        return results

# æ€§èƒ½å¯¹æ¯”
urls = ['http://example.com'] * 10

# åŒæ­¥æ–¹å¼ï¼šè€—æ—¶çº¦10ç§’
start_time = time.time()
sync_results = fetch_urls_sync(urls)
sync_time = time.time() - start_time

# å¼‚æ­¥æ–¹å¼ï¼šè€—æ—¶çº¦1ç§’
start_time = time.time()
async_results = asyncio.run(fetch_urls_async(urls))
async_time = time.time() - start_time

print(f"åŒæ­¥è€—æ—¶ï¼š{sync_time:.2f}ç§’")
print(f"å¼‚æ­¥è€—æ—¶ï¼š{async_time:.2f}ç§’")
```

### 6.4 å¼‚æ­¥å¤„ç†æœ€ä½³å®è·µ


**ğŸ”¸ ä»»åŠ¡åˆ†ç±»å¤„ç†**

```python
# æ ¹æ®ä»»åŠ¡é‡è¦æ€§åˆ†é…ä¸åŒé˜Ÿåˆ—
class TaskPriority:
    HIGH = 'high_priority_queue'      # é‡è¦ä»»åŠ¡ï¼šæ”¯ä»˜ã€è®¢å•
    NORMAL = 'normal_priority_queue'  # æ™®é€šä»»åŠ¡ï¼šé‚®ä»¶ã€æ¨é€
    LOW = 'low_priority_queue'        # ä½ä¼˜å…ˆçº§ï¼šç»Ÿè®¡ã€æ¸…ç†

def submit_task(task_type, task_data, priority=TaskPriority.NORMAL):
    task = {
        'type': task_type,
        'data': task_data,
        'created_at': time.time()
    }
    
    redis_client.lpush(priority, json.dumps(task))

# ä¸åŒä¼˜å…ˆçº§ä½¿ç”¨ä¸åŒçš„æ¶ˆè´¹è€…æ•°é‡
# é«˜ä¼˜å…ˆçº§ï¼š4ä¸ªæ¶ˆè´¹è€…
# æ™®é€šä¼˜å…ˆçº§ï¼š2ä¸ªæ¶ˆè´¹è€…  
# ä½ä¼˜å…ˆçº§ï¼š1ä¸ªæ¶ˆè´¹è€…
```

**âš ï¸ å¼‚æ­¥å¤„ç†æ³¨æ„äº‹é¡¹**

> **é”™è¯¯å¤„ç†**ï¼šå¼‚æ­¥ä»»åŠ¡å‡ºé”™æ—¶ï¼Œç”¨æˆ·å¯èƒ½å·²ç»ç¦»å¼€ï¼Œéœ€è¦å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé€šçŸ¥æœºåˆ¶
> 
> **å¹‚ç­‰æ€§**ï¼šç¡®ä¿é‡å¤æ‰§è¡ŒåŒä¸€ä»»åŠ¡ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨
> 
> **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§é˜Ÿåˆ—é•¿åº¦ï¼Œé˜²æ­¢ä»»åŠ¡ç§¯å‹

---

## 7. âš–ï¸ è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©


### 7.1 è´Ÿè½½å‡è¡¡åŸºæœ¬æ¦‚å¿µ


**è´Ÿè½½å‡è¡¡ä½œç”¨**ï¼šå°±åƒè¶…å¸‚æ”¶é“¶å°ï¼Œå¦‚æœåªå¼€ä¸€ä¸ªæ”¶é“¶å°ï¼Œé¡¾å®¢è¦æ’é•¿é˜Ÿï¼›å¼€å¤šä¸ªæ”¶é“¶å°å¹¶åˆç†åˆ†é…é¡¾å®¢ï¼Œå°±èƒ½æé«˜æ•´ä½“æ•ˆç‡ã€‚

**è´Ÿè½½å‡è¡¡å±‚æ¬¡**ï¼š
```
                    ç”¨æˆ·è¯·æ±‚
                        â†“
                  DNSè´Ÿè½½å‡è¡¡ â† å…¨å±€è´Ÿè½½åˆ†å‘
                        â†“
                  ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨ â† ä¼ä¸šçº§é«˜æ€§èƒ½
                        â†“
                  è½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ â† çµæ´»å¯é…ç½®
                        â†“
                  åº”ç”¨æœåŠ¡å™¨é›†ç¾¤
```

### 7.2 è´Ÿè½½å‡è¡¡ç®—æ³•å¯¹æ¯”


**ğŸ”¸ å¸¸ç”¨ç®—æ³•ç‰¹ç‚¹**

| ç®—æ³• | **å·¥ä½œåŸç†** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|------|------------|-------------|-----------|
| `è½®è¯¢` | `ä¾æ¬¡åˆ†é…è¯·æ±‚` | `æœåŠ¡å™¨æ€§èƒ½ç›¸ä¼¼` | `ç®€å•ä½†ä¸è€ƒè™‘è´Ÿè½½` |
| `åŠ æƒè½®è¯¢` | `æ ¹æ®æƒé‡åˆ†é…` | `æœåŠ¡å™¨æ€§èƒ½ä¸åŒ` | `çµæ´»ä½†é…ç½®å¤æ‚` |
| `æœ€å°‘è¿æ¥` | `åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨` | `é•¿è¿æ¥æœåŠ¡` | `è€ƒè™‘è´Ÿè½½ä½†è®¡ç®—å¼€é”€å¤§` |
| `IPå“ˆå¸Œ` | `æ ¹æ®å®¢æˆ·ç«¯IPåˆ†é…` | `éœ€è¦ä¼šè¯ä¿æŒ` | `ä¿æŒä¼šè¯ä½†å¯èƒ½ä¸å‡è¡¡` |

**ğŸ”§ Nginxè´Ÿè½½å‡è¡¡é…ç½®**

```nginx
# å®šä¹‰åç«¯æœåŠ¡å™¨ç»„
upstream backend_servers {
    # åŠ æƒè½®è¯¢
    server 192.168.1.10:8080 weight=3;  # æƒé‡3
    server 192.168.1.11:8080 weight=1;  # æƒé‡1
    server 192.168.1.12:8080 backup;    # å¤‡ç”¨æœåŠ¡å™¨
    
    # æœ€å°‘è¿æ¥ç®—æ³•
    # least_conn;
    
    # IPå“ˆå¸Œç®—æ³•
    # ip_hash;
    
    # å¥åº·æ£€æŸ¥
    server 192.168.1.10:8080 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    server_name example.com;
    
    location / {
        proxy_pass http://backend_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # è¿æ¥è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 5s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
    }
}
```

### 7.3 ä¼šè¯ä¿æŒç­–ç•¥


**ğŸ”¸ ä¼šè¯ä¿æŒçš„å¿…è¦æ€§**

åœ¨ç”µå•†ç½‘ç«™ä¸­ï¼Œç”¨æˆ·ç™»å½•åçš„è´­ç‰©è½¦ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ã€‚å¦‚æœæ²¡æœ‰ä¼šè¯ä¿æŒï¼Œç”¨æˆ·çš„è¯·æ±‚å¯èƒ½è¢«åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œå¯¼è‡´è´­ç‰©è½¦ä¿¡æ¯ä¸¢å¤±ã€‚

**è§£å†³æ–¹æ¡ˆå¯¹æ¯”**ï¼š

```
æ–¹æ¡ˆ1ï¼šIPå“ˆå¸Œï¼ˆç®€å•ä½†ä¸çµæ´»ï¼‰
nginx: ip_hash;

æ–¹æ¡ˆ2ï¼šCookieç²˜æ€§ä¼šè¯
nginx: 
upstream backend {
    server 192.168.1.10:8080 route=server1;
    server 192.168.1.11:8080 route=server2;
    sticky route $cookie_jsessionid;
}

æ–¹æ¡ˆ3ï¼šå…±äº«ä¼šè¯å­˜å‚¨ï¼ˆæ¨èï¼‰
åº”ç”¨æœåŠ¡å™¨ â†’ Redis/æ•°æ®åº“ â† åº”ç”¨æœåŠ¡å™¨
      â†“                    â†“
   ä¼šè¯æ•°æ®å…±äº«å­˜å‚¨      ä¼šè¯æ•°æ®å…±äº«å­˜å‚¨
```

### 7.4 å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»


**ğŸ”¸ å¥åº·æ£€æŸ¥é…ç½®**

```nginx
upstream backend {
    server 192.168.1.10:8080 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:8080 max_fails=3 fail_timeout=30s;
    
    # max_fails: è¿ç»­å¤±è´¥3æ¬¡æ ‡è®°ä¸ºä¸å¯ç”¨
    # fail_timeout: 30ç§’åé‡æ–°å°è¯•
}

# è‡ªå®šä¹‰å¥åº·æ£€æŸ¥
location /health {
    access_log off;
    return 200 "healthy\n";
    add_header Content-Type text/plain;
}
```

**æ•…éšœè½¬ç§»æµç¨‹**ï¼š
```
1. æ£€æµ‹åˆ°æœåŠ¡å™¨æ•…éšœ
         â†“
2. å°†æœåŠ¡å™¨æ ‡è®°ä¸ºä¸å¯ç”¨
         â†“
3. å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–å¥åº·æœåŠ¡å™¨
         â†“
4. å®šæœŸæ£€æŸ¥æ•…éšœæœåŠ¡å™¨çŠ¶æ€
         â†“
5. æœåŠ¡å™¨æ¢å¤åé‡æ–°åŠ å…¥é›†ç¾¤
```

**ğŸ“Š è´Ÿè½½å‡è¡¡ç›‘æ§**

```bash
# æŸ¥çœ‹NginxçŠ¶æ€
curl http://localhost/nginx_status

# è¾“å‡ºè§£é‡Šï¼š
# Active connections: 291    # å½“å‰æ´»è·ƒè¿æ¥æ•°
# server accepts handled requests
#  16630948 16630948 31070465    
# Reading: 6 Writing: 179 Waiting: 106

# ç›‘æ§åç«¯æœåŠ¡å™¨çŠ¶æ€
curl http://localhost/upstream_status
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ€§èƒ½ç“¶é¢ˆå®šä½ï¼šä½¿ç”¨ç³»ç»Ÿå·¥å…·å¿«é€Ÿè¯†åˆ«CPUã€å†…å­˜ã€IOã€ç½‘ç»œç“¶é¢ˆ
ğŸ”¸ æ•°æ®åº“ä¼˜åŒ–ï¼šSQLä¼˜åŒ–ã€ç´¢å¼•è®¾è®¡ã€è¿æ¥é…ç½®æ˜¯æ€§èƒ½æå‡çš„å…³é”®
ğŸ”¸ WebæœåŠ¡å™¨è°ƒä¼˜ï¼šåˆç†é…ç½®å¹¶å‘å‚æ•°ã€å¯ç”¨å‹ç¼©ã€ä¼˜åŒ–é™æ€èµ„æº
ğŸ”¸ ç¼“å­˜ç­–ç•¥ï¼šå¤šå±‚ç¼“å­˜è®¾è®¡ã€å¤±æ•ˆç­–ç•¥ã€æ€§èƒ½ç›‘æ§
ğŸ”¸ è¿æ¥æ± ä¼˜åŒ–ï¼šåˆç†è®¾ç½®è¿æ¥æ•°ã€ç›‘æ§ä½¿ç”¨ç‡ã€é¿å…è¿æ¥æ³„æ¼
ğŸ”¸ å¼‚æ­¥å¤„ç†ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€å¼‚æ­¥IOæå‡ç³»ç»Ÿå¹¶å‘å¤„ç†èƒ½åŠ›
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šç®—æ³•é€‰æ‹©ã€ä¼šè¯ä¿æŒã€å¥åº·æ£€æŸ¥ä¿éšœé«˜å¯ç”¨
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å±‚æ¬¡æ€§**
```
åº”ç”¨å±‚ä¼˜åŒ–ï¼šä»£ç é€»è¾‘ã€ç®—æ³•æ”¹è¿›
ä¸­é—´ä»¶ä¼˜åŒ–ï¼šWebæœåŠ¡å™¨ã€æ•°æ®åº“é…ç½®  
ç³»ç»Ÿå±‚ä¼˜åŒ–ï¼šæ“ä½œç³»ç»Ÿå‚æ•°ã€ç¡¬ä»¶èµ„æº
ç½‘ç»œå±‚ä¼˜åŒ–ï¼šè´Ÿè½½å‡è¡¡ã€CDNåŠ é€Ÿ
```

**ğŸ”¹ ä¼˜åŒ–çš„ä¼˜å…ˆçº§åŸåˆ™**
```
1. å…ˆä¼˜åŒ–å½±å“æœ€å¤§çš„ç“¶é¢ˆ
2. ä¼˜å…ˆè€ƒè™‘æˆæœ¬æœ€ä½çš„æ–¹æ¡ˆ
3. æƒè¡¡æ€§èƒ½æå‡ä¸å¤æ‚åº¦å¢åŠ 
4. æŒç»­ç›‘æ§å’Œæ¸è¿›å¼ä¼˜åŒ–
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯**
- **ç”µå•†ç½‘ç«™**ï¼šç¼“å­˜å•†å“ä¿¡æ¯ï¼Œæ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼Œè´Ÿè½½å‡è¡¡å¤„ç†ä¿ƒé”€å³°å€¼
- **ç¤¾äº¤å¹³å°**ï¼šå¼‚æ­¥å¤„ç†æ¶ˆæ¯æ¨é€ï¼ŒRedisç¼“å­˜ç”¨æˆ·ä¼šè¯ï¼Œæ•°æ®åº“è¯»å†™åˆ†ç¦»
- **ä¼ä¸šç³»ç»Ÿ**ï¼šè¿æ¥æ± ä¼˜åŒ–æ•°æ®åº“è®¿é—®ï¼ŒWebæœåŠ¡å™¨é…ç½®æå‡å¹¶å‘èƒ½åŠ›
- **å†…å®¹ç½‘ç«™**ï¼šé™æ€èµ„æºä¼˜åŒ–ï¼ŒCDNåŠ é€Ÿï¼Œæ•°æ®åº“ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦

**ğŸ”§ è¿ç»´å®è·µè¦ç‚¹**
```
ç›‘æ§å…ˆè¡Œï¼šå»ºç«‹å®Œå–„çš„æ€§èƒ½ç›‘æ§ä½“ç³»
æ¸è¿›ä¼˜åŒ–ï¼šå°æ­¥å¿«è·‘ï¼Œé¿å…å¤§å¹…åº¦å˜æ›´
å‹åŠ›æµ‹è¯•ï¼šä¼˜åŒ–åè¿›è¡Œå‹åŠ›æµ‹è¯•éªŒè¯æ•ˆæœ
å®¹é‡è§„åˆ’ï¼šæ ¹æ®ä¸šåŠ¡å¢é•¿é¢„æµ‹èµ„æºéœ€æ±‚
æ•…éšœé¢„æ¡ˆï¼šåˆ¶å®šæ€§èƒ½é—®é¢˜çš„åº”æ€¥å¤„ç†æµç¨‹
```

### 8.4 ä¼˜åŒ–æ•ˆæœè¯„ä¼°


**ğŸ“Š å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼ˆKPIï¼‰**

| æŒ‡æ ‡ç±»å‹ | **å…·ä½“æŒ‡æ ‡** | **æ­£å¸¸èŒƒå›´** | **ä¼˜åŒ–ç›®æ ‡** |
|---------|------------|-------------|-------------|
| `å“åº”æ—¶é—´` | `é¡µé¢åŠ è½½æ—¶é—´` | `<3ç§’` | `<1ç§’` |
| `å¹¶å‘èƒ½åŠ›` | `æ¯ç§’è¯·æ±‚æ•°(QPS)` | `>1000` | `>5000` |
| `ç³»ç»Ÿèµ„æº` | `CPUä½¿ç”¨ç‡` | `<70%` | `<50%` |
| `ç¼“å­˜æ•ˆæœ` | `ç¼“å­˜å‘½ä¸­ç‡` | `>80%` | `>95%` |

**æ ¸å¿ƒè®°å¿†**ï¼š
- åº”ç”¨ä¼˜åŒ–é‡åœ¨æ‰¾ç“¶é¢ˆï¼Œå·¥å…·ç›‘æ§å®šä½å‡†
- æ•°æ®åº“ä¼˜åŒ–SQLå…ˆè¡Œï¼Œç´¢å¼•è®¾è®¡æ˜¯å…³é”®  
- ç¼“å­˜å¼‚æ­¥ææ€§èƒ½ï¼Œè¿æ¥æ± å­è¦é…å¥½
- è´Ÿè½½å‡è¡¡ä¿å¯ç”¨ï¼ŒæŒç»­ç›‘æ§ä¸èƒ½å°‘