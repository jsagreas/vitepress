---
title: 16ã€å®¡è®¡æ—¥å¿—ä¸åˆè§„ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [å®¡è®¡ç³»ç»ŸåŸºç¡€æ¦‚å¿µ](#1-å®¡è®¡ç³»ç»ŸåŸºç¡€æ¦‚å¿µ)
2. [auditdå®¡è®¡ç³»ç»Ÿè¯¦è§£](#2-auditdå®¡è®¡ç³»ç»Ÿè¯¦è§£)
3. [ç”¨æˆ·è¡Œä¸ºå®¡è®¡é…ç½®](#3-ç”¨æˆ·è¡Œä¸ºå®¡è®¡é…ç½®)
4. [æ–‡ä»¶è®¿é—®å®¡è®¡ç›‘æ§](#4-æ–‡ä»¶è®¿é—®å®¡è®¡ç›‘æ§)
5. [ç³»ç»Ÿè°ƒç”¨å®¡è®¡é…ç½®](#5-ç³»ç»Ÿè°ƒç”¨å®¡è®¡é…ç½®)
6. [å®¡è®¡æ—¥å¿—åˆ†æå·¥å…·](#6-å®¡è®¡æ—¥å¿—åˆ†æå·¥å…·)
7. [åˆè§„æŠ¥å‘Šç”Ÿæˆ](#7-åˆè§„æŠ¥å‘Šç”Ÿæˆ)
8. [å®¡è®¡ç­–ç•¥ä¸é•¿æœŸä¿å­˜](#8-å®¡è®¡ç­–ç•¥ä¸é•¿æœŸä¿å­˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å®¡è®¡ç³»ç»ŸåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å®¡è®¡ç³»ç»Ÿ


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> å®¡è®¡ç³»ç»Ÿæ˜¯Linuxç³»ç»Ÿä¸­ç”¨äºç›‘æ§å’Œè®°å½•å®‰å…¨ç›¸å…³äº‹ä»¶çš„æœºåˆ¶ï¼Œå®ƒèƒ½å¤Ÿè¿½è¸ªç”¨æˆ·æ´»åŠ¨ã€ç³»ç»Ÿè°ƒç”¨ã€æ–‡ä»¶è®¿é—®ç­‰è¡Œä¸ºï¼Œä¸ºå®‰å…¨åˆ†æå’Œåˆè§„è¦æ±‚æä¾›è¯¦ç»†çš„æ—¥å¿—è®°å½•ã€‚

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼šå®¡è®¡ç³»ç»Ÿå°±åƒé“¶è¡Œçš„ç›‘æ§æ‘„åƒå¤´å’Œäº¤æ˜“è®°å½•ç³»ç»Ÿï¼Œå®ƒä¼šè¯¦ç»†è®°å½•"è°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆäº‹æƒ…"ï¼Œç¡®ä¿æ‰€æœ‰é‡è¦æ“ä½œéƒ½æœ‰æ®å¯æŸ¥ã€‚

### 1.2 å®¡è®¡ç³»ç»Ÿçš„ä½œç”¨


```
ğŸ¯ **ä¸»è¦åŠŸèƒ½**
å®‰å…¨ç›‘æ§ â”€â”€> è®°å½•å¯ç–‘æ´»åŠ¨å’Œå®‰å…¨äº‹ä»¶
åˆè§„è¦æ±‚ â”€â”€> æ»¡è¶³æ³•è§„å’Œæ ‡å‡†è¦æ±‚  
æ•…éšœæ’æŸ¥ â”€â”€> åˆ†æç³»ç»Ÿé—®é¢˜å’Œé”™è¯¯
æ€§èƒ½åˆ†æ â”€â”€> ç›‘æ§ç³»ç»Ÿè°ƒç”¨æ€§èƒ½
```

**ğŸ”¸ å…·ä½“åº”ç”¨åœºæ™¯**ï¼š
- **å®‰å…¨äº‹ä»¶è¿½è¸ª**ï¼šå‘ç°å…¥ä¾µè¡Œä¸ºå’Œå¼‚å¸¸æ“ä½œ
- **åˆè§„å®¡è®¡**ï¼šæ»¡è¶³SOXã€HIPAAç­‰æ³•è§„è¦æ±‚
- **æƒé™ç®¡ç†**ï¼šç›‘æ§ç‰¹æƒç”¨æˆ·çš„æ“ä½œè¡Œä¸º
- **æ•°æ®ä¿æŠ¤**ï¼šè¿½è¸ªæ•æ„Ÿæ–‡ä»¶çš„è®¿é—®è®°å½•

### 1.3 Linuxå®¡è®¡æ¡†æ¶ç»“æ„


```
å®¡è®¡ç³»ç»Ÿæ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç©ºé—´å·¥å…·   â”‚ â† aureportã€ausearchã€auditctl
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   auditdå®ˆæŠ¤è¿›ç¨‹ â”‚ â† æ—¥å¿—æ”¶é›†å’Œå­˜å‚¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å†…æ ¸å®¡è®¡æ¨¡å—   â”‚ â† ç³»ç»Ÿè°ƒç”¨æ‹¦æˆª
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å†…æ ¸ç©ºé—´      â”‚ â† å®é™…çš„ç³»ç»Ÿè°ƒç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âš™ï¸ auditdå®¡è®¡ç³»ç»Ÿè¯¦è§£


### 2.1 auditdç³»ç»Ÿç»„æˆ


**ğŸ”§ æ ¸å¿ƒç»„ä»¶**ï¼š
- **`auditd`**ï¼šå®¡è®¡å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£æ”¶é›†å’Œè®°å½•å®¡è®¡äº‹ä»¶
- **`auditctl`**ï¼šå®¡è®¡è§„åˆ™ç®¡ç†å·¥å…·
- **`ausearch`**ï¼šå®¡è®¡æ—¥å¿—æœç´¢å·¥å…·
- **`aureport`**ï¼šå®¡è®¡æŠ¥å‘Šç”Ÿæˆå·¥å…·

> ğŸ’¡ **ç®€å•ç†è§£**  
> auditdå°±åƒä¸€ä¸ªä¸“ä¸šçš„"è®°å½•å‘˜"ï¼Œauditctlæ˜¯"è§„åˆ™åˆ¶å®šè€…"ï¼Œausearchæ˜¯"æ¡£æ¡ˆç®¡ç†å‘˜"ï¼Œaureportæ˜¯"æŠ¥å‘Šç”Ÿæˆå™¨"

### 2.2 auditdå®‰è£…ä¸å¯åŠ¨


**ğŸ“‹ å®‰è£…æ­¥éª¤**ï¼š
```bash
# CentOS/RHELç³»ç»Ÿ
sudo yum install audit audit-libs

# Ubuntu/Debianç³»ç»Ÿ  
sudo apt-get install auditd audispd-plugins

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start auditd
sudo systemctl enable auditd
```

**âœ… éªŒè¯å®‰è£…**ï¼š
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status auditd

# æŸ¥çœ‹å®¡è®¡çŠ¶æ€
sudo auditctl -s

# æŸ¥çœ‹å½“å‰è§„åˆ™
sudo auditctl -l
```

### 2.3 auditdä¸»é…ç½®æ–‡ä»¶


**ğŸ“„ `/etc/audit/auditd.conf` æ ¸å¿ƒé…ç½®**ï¼š

```bash
# æ—¥å¿—æ–‡ä»¶ä½ç½®
log_file = /var/log/audit/audit.log

# æ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°(MB)
max_log_file = 50

# å½“æ—¥å¿—æ–‡ä»¶æ»¡æ—¶çš„åŠ¨ä½œ
max_log_file_action = ROTATE

# ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡
num_logs = 5

# ç£ç›˜ç©ºé—´ä¸è¶³æ—¶çš„åŠ¨ä½œ
space_left_action = SYSLOG
admin_space_left_action = SUSPEND

# ç£ç›˜æ»¡æ—¶çš„åŠ¨ä½œ
disk_full_action = SUSPEND
disk_error_action = SUSPEND
```

**ğŸ” é…ç½®å‚æ•°è§£é‡Š**ï¼š
- **`ROTATE`**ï¼šè½®è½¬æ—¥å¿—æ–‡ä»¶ï¼Œåˆ›å»ºæ–°æ–‡ä»¶
- **`SUSPEND`**ï¼šæš‚åœå®¡è®¡ï¼Œä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§
- **`SYSLOG`**ï¼šå‘é€è­¦å‘Šåˆ°ç³»ç»Ÿæ—¥å¿—

---

## 3. ğŸ‘¤ ç”¨æˆ·è¡Œä¸ºå®¡è®¡é…ç½®


### 3.1 ç”¨æˆ·ç™»å½•å®¡è®¡


**ğŸ¯ ç›‘æ§ç›®æ ‡**ï¼šè®°å½•ç”¨æˆ·ç™»å½•ã€æ³¨é”€å’Œè®¤è¯äº‹ä»¶

```bash
# ç›‘æ§ç”¨æˆ·è®¤è¯äº‹ä»¶
sudo auditctl -w /etc/passwd -p wa -k user_accounts
sudo auditctl -w /etc/shadow -p wa -k user_accounts  
sudo auditctl -w /etc/group -p wa -k user_accounts

# ç›‘æ§ç™»å½•å¤±è´¥
sudo auditctl -a always,exit -F arch=b64 -S execve -F exe=/bin/login -k user_login
sudo auditctl -a always,exit -F arch=b64 -S execve -F exe=/usr/sbin/sshd -k ssh_login
```

**ğŸ“Š å‚æ•°è¯´æ˜**ï¼š
- **`-w`**ï¼šç›‘æ§æ–‡ä»¶è·¯å¾„(watch)
- **`-p`**ï¼šæƒé™è¿‡æ»¤å™¨(r=è¯»,w=å†™,x=æ‰§è¡Œ,a=å±æ€§ä¿®æ”¹)
- **`-k`**ï¼šå…³é”®å­—æ ‡ç­¾ï¼Œä¾¿äºæœç´¢
- **`-a`**ï¼šæ·»åŠ è§„åˆ™(always,exitè¡¨ç¤ºæ€»æ˜¯è®°å½•ç³»ç»Ÿè°ƒç”¨é€€å‡º)

### 3.2 ç‰¹æƒç”¨æˆ·æ“ä½œå®¡è®¡


**ğŸ”¥ é‡ç‚¹ç›‘æ§**ï¼šrootç”¨æˆ·å’Œsudoæ“ä½œ

```bash
# ç›‘æ§sudoå‘½ä»¤ä½¿ç”¨
sudo auditctl -a always,exit -F arch=b64 -S execve -F exe=/usr/bin/sudo -k sudo_usage

# ç›‘æ§suå‘½ä»¤ä½¿ç”¨
sudo auditctl -a always,exit -F arch=b64 -S execve -F exe=/bin/su -k su_usage

# ç›‘æ§rootç”¨æˆ·çš„æ‰€æœ‰å‘½ä»¤
sudo auditctl -a always,exit -F arch=b64 -S execve -F uid=0 -k root_commands
```

**ğŸ’¡ å®ç”¨æŠ€å·§**ï¼šåˆ›å»ºç”¨æˆ·è¡Œä¸ºå®¡è®¡è§„åˆ™æ–‡ä»¶
```bash
# åˆ›å»ºä¸“é—¨çš„ç”¨æˆ·å®¡è®¡è§„åˆ™
sudo cat > /etc/audit/rules.d/user-behavior.rules << EOF
# ç”¨æˆ·è´¦æˆ·ç®¡ç†
-w /etc/passwd -p wa -k user_accounts
-w /etc/shadow -p wa -k user_accounts
-w /etc/group -p wa -k user_accounts

# ç‰¹æƒæå‡ç›‘æ§
-a always,exit -F arch=b64 -S execve -F exe=/usr/bin/sudo -k sudo_usage
-a always,exit -F arch=b64 -S execve -F exe=/bin/su -k su_usage

# ç”¨æˆ·ç™»å½•ç›‘æ§
-w /var/log/lastlog -p wa -k user_login
-w /var/log/wtmp -p wa -k user_login
EOF

# é‡è½½å®¡è®¡è§„åˆ™
sudo service auditd restart
```

### 3.3 ç”¨æˆ·è¡Œä¸ºåˆ†æå®ä¾‹


**ğŸ” æŸ¥çœ‹ç”¨æˆ·ç™»å½•è®°å½•**ï¼š
```bash
# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„sudoä½¿ç”¨è®°å½•
sudo ausearch -k sudo_usage -ui 1000

# æŸ¥çœ‹rootç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ
sudo ausearch -k root_commands -ts today

# ç”Ÿæˆç”¨æˆ·è¡Œä¸ºæŠ¥å‘Š
sudo aureport -u --summary
```

---

## 4. ğŸ“ æ–‡ä»¶è®¿é—®å®¡è®¡ç›‘æ§


### 4.1 æ•æ„Ÿæ–‡ä»¶ç›‘æ§


**ğŸ›¡ï¸ é‡è¦æ–‡ä»¶ç›‘æ§é…ç½®**ï¼š

```bash
# ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›‘æ§
sudo auditctl -w /etc/hosts -p wa -k network_config
sudo auditctl -w /etc/resolv.conf -p wa -k network_config
sudo auditctl -w /etc/ssh/sshd_config -p wa -k ssh_config

# å…³é”®ç³»ç»Ÿæ–‡ä»¶ç›‘æ§
sudo auditctl -w /etc/crontab -p wa -k cron_config
sudo auditctl -w /etc/sudoers -p wa -k sudo_config
sudo auditctl -w /boot/grub/grub.cfg -p wa -k boot_config
```

**ğŸ“‚ æ•æ„Ÿç›®å½•ç›‘æ§**ï¼š
```bash
# ç›‘æ§ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶ç›®å½•
sudo auditctl -w /bin/ -p wa -k system_binaries
sudo auditctl -w /sbin/ -p wa -k system_binaries
sudo auditctl -w /usr/bin/ -p wa -k system_binaries

# ç›‘æ§æ—¥å¿—ç›®å½•
sudo auditctl -w /var/log/ -p wa -k log_access

# ç›‘æ§ä¸´æ—¶ç›®å½•çš„å¯æ‰§è¡Œæ–‡ä»¶
sudo auditctl -w /tmp/ -p x -k temp_exec
```

### 4.2 æ–‡ä»¶è®¿é—®å®¡è®¡è§„åˆ™


**ğŸ“‹ å®Œæ•´çš„æ–‡ä»¶ç›‘æ§è§„åˆ™**ï¼š
```bash
# åˆ›å»ºæ–‡ä»¶è®¿é—®å®¡è®¡è§„åˆ™
sudo cat > /etc/audit/rules.d/file-access.rules << EOF
# ç³»ç»Ÿé…ç½®æ–‡ä»¶
-w /etc/passwd -p wa -k passwd_changes
-w /etc/shadow -p wa -k shadow_changes
-w /etc/hosts -p wa -k network_modifications

# SSHé…ç½®
-w /etc/ssh/sshd_config -p wa -k ssh_config_changes
-w /root/.ssh/ -p wa -k root_ssh_keys

# å®šæ—¶ä»»åŠ¡é…ç½®
-w /etc/crontab -p wa -k cron_changes
-w /var/spool/cron/ -p wa -k user_cron

# ç³»ç»ŸæœåŠ¡é…ç½®
-w /etc/systemd/ -p wa -k systemd_changes
-w /usr/lib/systemd/ -p wa -k systemd_changes

# å†…æ ¸æ¨¡å—
-w /lib/modules/ -p wa -k kernel_modules
EOF
```

### 4.3 æ–‡ä»¶è®¿é—®äº‹ä»¶åˆ†æ


**ğŸ” åˆ†ææ–‡ä»¶è®¿é—®è®°å½•**ï¼š
```bash
# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„è®¿é—®è®°å½•
sudo ausearch -f /etc/passwd -ts today

# æŸ¥çœ‹ç³»ç»Ÿé…ç½®æ–‡ä»¶çš„ä¿®æ”¹
sudo ausearch -k passwd_changes -ts this-week

# ç”Ÿæˆæ–‡ä»¶è®¿é—®æŠ¥å‘Š
sudo aureport -f --summary -ts this-month
```

**ğŸ“Š æ–‡ä»¶è®¿é—®ç»Ÿè®¡**ï¼š
```bash
# æŒ‰ç”¨æˆ·ç»Ÿè®¡æ–‡ä»¶è®¿é—®
sudo aureport -u -i

# æŒ‰æ–‡ä»¶ç»Ÿè®¡è®¿é—®æ¬¡æ•°  
sudo aureport -f -i

# æŸ¥çœ‹æœ€è¿‘çš„æ–‡ä»¶ä¿®æ”¹äº‹ä»¶
sudo ausearch -m PATH -ts recent
```

---

## 5. ğŸ”§ ç³»ç»Ÿè°ƒç”¨å®¡è®¡é…ç½®


### 5.1 ç³»ç»Ÿè°ƒç”¨åŸºç¡€æ¦‚å¿µ


> ğŸ“– **ä»€ä¹ˆæ˜¯ç³»ç»Ÿè°ƒç”¨**  
> ç³»ç»Ÿè°ƒç”¨æ˜¯åº”ç”¨ç¨‹åºè¯·æ±‚æ“ä½œç³»ç»Ÿå†…æ ¸æœåŠ¡çš„æ¥å£ã€‚æ¯”å¦‚æ‰“å¼€æ–‡ä»¶ã€åˆ›å»ºè¿›ç¨‹ã€ç½‘ç»œé€šä¿¡ç­‰æ“ä½œéƒ½éœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆã€‚

**ğŸ’¡ ç®€å•ç†è§£**ï¼šç³»ç»Ÿè°ƒç”¨å°±åƒé¤å…çš„æœåŠ¡å‘˜ï¼Œåº”ç”¨ç¨‹åºæ˜¯å®¢äººï¼Œå†…æ ¸æ˜¯å¨æˆ¿ï¼Œå®¢äºº(åº”ç”¨)æƒ³è¦ä»€ä¹ˆæœåŠ¡éƒ½è¦é€šè¿‡æœåŠ¡å‘˜(ç³»ç»Ÿè°ƒç”¨)æ¥ä¼ è¾¾ç»™å¨æˆ¿(å†…æ ¸)ã€‚

### 5.2 é‡è¦ç³»ç»Ÿè°ƒç”¨ç›‘æ§


**ğŸ¯ æ ¸å¿ƒç³»ç»Ÿè°ƒç”¨å®¡è®¡**ï¼š

```bash
# æ–‡ä»¶æ“ä½œç³»ç»Ÿè°ƒç”¨
sudo auditctl -a always,exit -F arch=b64 -S open,openat,creat -k file_operations
sudo auditctl -a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -k file_deletions

# è¿›ç¨‹ç®¡ç†ç³»ç»Ÿè°ƒç”¨
sudo auditctl -a always,exit -F arch=b64 -S fork,vfork,clone -k process_creation
sudo auditctl -a always,exit -F arch=b64 -S execve -k program_execution

# ç½‘ç»œç›¸å…³ç³»ç»Ÿè°ƒç”¨
sudo auditctl -a always,exit -F arch=b64 -S socket,connect,bind,listen -k network_operations

# æƒé™ç›¸å…³ç³»ç»Ÿè°ƒç”¨
sudo auditctl -a always,exit -F arch=b64 -S chmod,fchmod,chown,fchown -k permission_changes
sudo auditctl -a always,exit -F arch=b64 -S setuid,setgid,setreuid,setregid -k privilege_escalation
```

### 5.3 ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤è§„åˆ™


**ğŸ” ç²¾ç¡®è¿‡æ»¤é…ç½®**ï¼š
```bash
# åªç›‘æ§å¤±è´¥çš„ç³»ç»Ÿè°ƒç”¨
sudo auditctl -a always,exit -F arch=b64 -S open -F exit=-EACCES -k file_access_denied
sudo auditctl -a always,exit -F arch=b64 -S open -F exit=-EPERM -k file_permission_denied

# ç›‘æ§ç‰¹å®šç”¨æˆ·çš„ç³»ç»Ÿè°ƒç”¨
sudo auditctl -a always,exit -F arch=b64 -S execve -F uid=1000 -k user_1000_exec

# ç›‘æ§ç‰¹å®šè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨
sudo auditctl -a always,exit -F arch=b64 -S all -F exe=/usr/bin/wget -k wget_usage
```

**ğŸ“‹ ç³»ç»Ÿè°ƒç”¨å®¡è®¡å®Œæ•´è§„åˆ™**ï¼š
```bash
# åˆ›å»ºç³»ç»Ÿè°ƒç”¨å®¡è®¡è§„åˆ™
sudo cat > /etc/audit/rules.d/syscalls.rules << EOF
# æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
-a always,exit -F arch=b64 -S open,openat,creat -F success=1 -k file_creation
-a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -k file_deletion
-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat -k file_permission_changes

# è¿›ç¨‹ç®¡ç†
-a always,exit -F arch=b64 -S execve -k process_execution
-a always,exit -F arch=b64 -S fork,vfork,clone -k process_creation

# ç½‘ç»œæ“ä½œ
-a always,exit -F arch=b64 -S socket,connect,accept -k network_connections
-a always,exit -F arch=b64 -S bind,listen -k network_bind

# æƒé™æå‡
-a always,exit -F arch=b64 -S setuid,setgid,setreuid,setregid -k privilege_escalation
-a always,exit -F arch=b64 -S setsid,setpgid -k session_management

# å†…å­˜ç®¡ç†
-a always,exit -F arch=b64 -S mmap,munmap,mprotect -k memory_operations
EOF
```

### 5.4 ç³»ç»Ÿè°ƒç”¨æ€§èƒ½è€ƒè™‘


> âš ï¸ **æ€§èƒ½è­¦å‘Š**  
> ç›‘æ§æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ä¼šæ˜¾è‘—å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œå»ºè®®åªç›‘æ§å…³é”®çš„å®‰å…¨ç›¸å…³ç³»ç»Ÿè°ƒç”¨ã€‚

**ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
```bash
# æ€§èƒ½å‹å¥½çš„ç›‘æ§è§„åˆ™
# åªç›‘æ§å¤±è´¥çš„æ“ä½œå’Œç‰¹æƒæ“ä½œ
-a always,exit -F arch=b64 -S open -F exit=-EACCES -k access_denied
-a always,exit -F arch=b64 -S execve -F uid=0 -k root_execution

# é¿å…ç›‘æ§é«˜é¢‘ç³»ç»Ÿè°ƒç”¨
# ä¸å»ºè®®ç›‘æ§: read, write, getpid, time ç­‰é«˜é¢‘è°ƒç”¨
```

---

## 6. ğŸ“Š å®¡è®¡æ—¥å¿—åˆ†æå·¥å…·


### 6.1 ausearchæ—¥å¿—æœç´¢


**ğŸ” åŸºæœ¬æœç´¢è¯­æ³•**ï¼š
```bash
# æŒ‰æ—¶é—´æœç´¢
sudo ausearch -ts today                    # ä»Šå¤©çš„è®°å½•
sudo ausearch -ts this-week               # æœ¬å‘¨çš„è®°å½•
sudo ausearch -ts 10/01/2023 -te 10/31/2023  # æŒ‡å®šæ—¶é—´èŒƒå›´

# æŒ‰å…³é”®å­—æœç´¢
sudo ausearch -k user_accounts            # æœç´¢ç‰¹å®šå…³é”®å­—
sudo ausearch -k sudo_usage -i           # ä»¥æ˜“è¯»æ ¼å¼æ˜¾ç¤º

# æŒ‰ç”¨æˆ·æœç´¢
sudo ausearch -ui 1000                    # æŒ‰ç”¨æˆ·IDæœç´¢
sudo ausearch -ue john                    # æŒ‰ç”¨æˆ·åæœç´¢
```

**ğŸ¯ é«˜çº§æœç´¢æŠ€å·§**ï¼š
```bash
# ç»„åˆæ¡ä»¶æœç´¢
sudo ausearch -k file_access -ui 1000 -ts today  # ç‰¹å®šç”¨æˆ·ä»Šå¤©çš„æ–‡ä»¶è®¿é—®

# æŒ‰æ¶ˆæ¯ç±»å‹æœç´¢
sudo ausearch -m USER_LOGIN              # ç”¨æˆ·ç™»å½•äº‹ä»¶
sudo ausearch -m USER_AUTH               # ç”¨æˆ·è®¤è¯äº‹ä»¶
sudo ausearch -m SYSCALL                 # ç³»ç»Ÿè°ƒç”¨äº‹ä»¶

# æŒ‰è¿›ç¨‹æœç´¢
sudo ausearch -p 1234                    # æŒ‰è¿›ç¨‹IDæœç´¢
sudo ausearch -x /bin/bash               # æŒ‰å¯æ‰§è¡Œæ–‡ä»¶æœç´¢
```

### 6.2 aureportæŠ¥å‘Šç”Ÿæˆ


**ğŸ“‹ åŸºç¡€æŠ¥å‘Šç”Ÿæˆ**ï¼š
```bash
# ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
sudo aureport --summary                  # æ•´ä½“æ¦‚å†µ
sudo aureport -u --summary              # ç”¨æˆ·æ´»åŠ¨æ±‡æ€»
sudo aureport -f --summary              # æ–‡ä»¶è®¿é—®æ±‡æ€»

# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
sudo aureport -au                        # ç”¨æˆ·è®¤è¯æŠ¥å‘Š
sudo aureport -l                         # ç™»å½•æŠ¥å‘Š
sudo aureport -x                         # å¯æ‰§è¡Œæ–‡ä»¶æŠ¥å‘Š
```

**ğŸ“Š ä¸“é¢˜æŠ¥å‘Šç¤ºä¾‹**ï¼š
```bash
# å®‰å…¨äº‹ä»¶æŠ¥å‘Š
sudo aureport -a                         # å¼‚å¸¸äº‹ä»¶æŠ¥å‘Š
sudo aureport --failed                   # å¤±è´¥äº‹ä»¶æŠ¥å‘Š
sudo aureport -n                         # å¼‚å¸¸ç½‘ç»œäº‹ä»¶

# æ—¶é—´èŒƒå›´æŠ¥å‘Š
sudo aureport -ts this-month -te today   # æœ¬æœˆåˆ°ä»Šå¤©çš„æŠ¥å‘Š
sudo aureport -x -ts yesterday           # æ˜¨å¤©çš„ç¨‹åºæ‰§è¡ŒæŠ¥å‘Š
```

### 6.3 è‡ªå®šä¹‰åˆ†æè„šæœ¬


**ğŸ”§ æ—¥å¿—åˆ†æè„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# å®¡è®¡æ—¥å¿—åˆ†æè„šæœ¬

# ç”Ÿæˆæ¯æ—¥å®‰å…¨æŠ¥å‘Š
generate_daily_security_report() {
    echo "=== æ¯æ—¥å®‰å…¨å®¡è®¡æŠ¥å‘Š $(date +%Y-%m-%d) ==="
    
    echo "1. ç”¨æˆ·ç™»å½•ç»Ÿè®¡:"
    sudo aureport -l -ts today --summary | tail -n +4
    
    echo -e "\n2. å¤±è´¥è®¤è¯å°è¯•:"
    sudo ausearch -m USER_AUTH -sv no -ts today | grep -c "msg=audit" || echo "0"
    
    echo -e "\n3. ç‰¹æƒæå‡äº‹ä»¶:"
    sudo ausearch -k sudo_usage -ts today | grep -c "msg=audit" || echo "0"
    
    echo -e "\n4. æ–‡ä»¶ä¿®æ”¹äº‹ä»¶:"
    sudo ausearch -k file_access -ts today | grep -c "msg=audit" || echo "0"
    
    echo -e "\n5. ç½‘ç»œè¿æ¥äº‹ä»¶:"
    sudo ausearch -k network_operations -ts today | grep -c "msg=audit" || echo "0"
}

# æ‰§è¡ŒæŠ¥å‘Šç”Ÿæˆ
generate_daily_security_report > /var/log/audit/daily-security-$(date +%Y%m%d).report
```

**ğŸ“ˆ å®¡è®¡æ•°æ®å¯è§†åŒ–**ï¼š
```bash
#!/bin/bash
# ç”ŸæˆCSVæ ¼å¼çš„ç»Ÿè®¡æ•°æ®ç”¨äºå›¾è¡¨åˆ†æ

# æ¯æ—¥ç™»å½•ç»Ÿè®¡
echo "Date,LoginCount,FailedCount" > login_stats.csv
for i in {1..30}; do
    date=$(date -d "$i days ago" +%Y-%m-%d)
    login_count=$(sudo ausearch -m USER_LOGIN -ts $date | grep -c "msg=audit" 2>/dev/null || echo "0")
    failed_count=$(sudo ausearch -m USER_AUTH -sv no -ts $date | grep -c "msg=audit" 2>/dev/null || echo "0")
    echo "$date,$login_count,$failed_count" >> login_stats.csv
done
```

---

## 7. ğŸ“‹ åˆè§„æŠ¥å‘Šç”Ÿæˆ


### 7.1 åˆè§„è¦æ±‚æ¦‚è¿°


> ğŸ“– **åˆè§„å®¡è®¡çš„é‡è¦æ€§**  
> è®¸å¤šè¡Œä¸šæ ‡å‡†å’Œæ³•è§„è¦æ±‚ç»„ç»‡å¿…é¡»å¯¹ç³»ç»Ÿè®¿é—®å’Œæ•°æ®æ“ä½œè¿›è¡Œè¯¦ç»†çš„å®¡è®¡è®°å½•ï¼Œå¦‚SOXæ³•æ¡ˆã€PCI DSSã€HIPAAç­‰ã€‚

**ğŸ¢ å¸¸è§åˆè§„æ ‡å‡†**ï¼š
- **SOX (è¨ç­æ–¯-å¥¥å…‹æ–¯åˆ©æ³•æ¡ˆ)**ï¼šè´¢åŠ¡æŠ¥å‘Šçš„å†…éƒ¨æ§åˆ¶
- **PCI DSS**ï¼šæ”¯ä»˜å¡è¡Œä¸šæ•°æ®å®‰å…¨æ ‡å‡†
- **HIPAA**ï¼šå¥åº·ä¿é™©æµé€šä¸è´£ä»»æ³•æ¡ˆ
- **ISO 27001**ï¼šä¿¡æ¯å®‰å…¨ç®¡ç†ä½“ç³»

### 7.2 åˆè§„æŠ¥å‘Šæ¨¡æ¿


**ğŸ“Š SOXåˆè§„æŠ¥å‘Šæ¨¡æ¿**ï¼š
```bash
#!/bin/bash
# SOXåˆè§„å®¡è®¡æŠ¥å‘Šç”Ÿæˆ

generate_sox_report() {
    local report_date=$(date +%Y-%m-%d)
    local report_file="/var/log/audit/sox-compliance-$report_date.html"
    
    cat > $report_file << EOF
<!DOCTYPE html>
<html>
<head>
    <title>SOXåˆè§„å®¡è®¡æŠ¥å‘Š - $report_date</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .summary { background-color: #e7f3ff; padding: 15px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>SOXåˆè§„å®¡è®¡æŠ¥å‘Š</h1>
    <div class="summary">
        <h2>æŠ¥å‘Šæ¦‚è¦</h2>
        <p>æŠ¥å‘Šæ—¥æœŸ: $report_date</p>
        <p>å®¡è®¡æœŸé—´: $(date -d '30 days ago' +%Y-%m-%d) è‡³ $report_date</p>
    </div>
    
    <h2>1. ç‰¹æƒç”¨æˆ·æ´»åŠ¨</h2>
    <table>
        <tr><th>ç”¨æˆ·</th><th>ç™»å½•æ¬¡æ•°</th><th>sudoä½¿ç”¨æ¬¡æ•°</th><th>å¤±è´¥è®¤è¯</th></tr>
EOF

    # ç”Ÿæˆç‰¹æƒç”¨æˆ·ç»Ÿè®¡
    for user in root $(getent passwd | awk -F: '$3 < 1000 && $3 > 0 {print $1}'); do
        login_count=$(sudo ausearch -ui $user -m USER_LOGIN -ts 30-days-ago | grep -c "msg=audit" 2>/dev/null || echo "0")
        sudo_count=$(sudo ausearch -ui $user -k sudo_usage -ts 30-days-ago | grep -c "msg=audit" 2>/dev/null || echo "0")
        failed_count=$(sudo ausearch -ui $user -m USER_AUTH -sv no -ts 30-days-ago | grep -c "msg=audit" 2>/dev/null || echo "0")
        echo "        <tr><td>$user</td><td>$login_count</td><td>$sudo_count</td><td>$failed_count</td></tr>" >> $report_file
    done
    
    cat >> $report_file << EOF
    </table>
    
    <h2>2. ç³»ç»Ÿé…ç½®æ›´æ”¹</h2>
    <p>å…³é”®ç³»ç»Ÿæ–‡ä»¶ä¿®æ”¹æ¬¡æ•°: $(sudo ausearch -k system_config -ts 30-days-ago | grep -c "msg=audit" 2>/dev/null || echo "0")</p>
    
    <h2>3. æ•°æ®è®¿é—®å®¡è®¡</h2>
    <p>æ•æ„Ÿæ–‡ä»¶è®¿é—®æ¬¡æ•°: $(sudo ausearch -k sensitive_data -ts 30-days-ago | grep -c "msg=audit" 2>/dev/null || echo "0")</p>
    
    <h2>4. å¼‚å¸¸äº‹ä»¶</h2>
    <p>æƒé™æ‹’ç»äº‹ä»¶: $(sudo ausearch -k access_denied -ts 30-days-ago | grep -c "msg=audit" 2>/dev/null || echo "0")</p>
    
    <p><em>æŠ¥å‘Šç”Ÿæˆæ—¶é—´: $(date)</em></p>
</body>
</html>
EOF

    echo "SOXåˆè§„æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

### 7.3 PCI DSSåˆè§„æ£€æŸ¥


**ğŸ’³ PCI DSSå®¡è®¡è¦ç‚¹**ï¼š
```bash
#!/bin/bash
# PCI DSSåˆè§„æ£€æŸ¥è„šæœ¬

pci_compliance_check() {
    echo "=== PCI DSSåˆè§„å®¡è®¡æ£€æŸ¥ ==="
    
    # éœ€æ±‚7: é™åˆ¶å¯¹æŒå¡äººæ•°æ®çš„è®¿é—®
    echo "1. è®¿é—®æ§åˆ¶æ£€æŸ¥:"
    echo "   - ç‰¹æƒç”¨æˆ·æ•°é‡: $(getent passwd | awk -F: '$3 == 0' | wc -l)"
    echo "   - sudoä½¿ç”¨è®°å½•: $(sudo ausearch -k sudo_usage -ts this-month | grep -c "msg=audit" || echo "0")"
    
    # éœ€æ±‚8: è¯†åˆ«å’Œè®¤è¯è®¿é—®
    echo -e "\n2. ç”¨æˆ·è®¤è¯æ£€æŸ¥:"
    echo "   - ç™»å½•å¤±è´¥æ¬¡æ•°: $(sudo ausearch -m USER_AUTH -sv no -ts this-month | grep -c "msg=audit" || echo "0")"
    echo "   - å¯†ç æ–‡ä»¶ä¿®æ”¹: $(sudo ausearch -k passwd_changes -ts this-month | grep -c "msg=audit" || echo "0")"
    
    # éœ€æ±‚10: ç½‘ç»œèµ„æºå’ŒæŒå¡äººæ•°æ®çš„æ‰€æœ‰è®¿é—®
    echo -e "\n3. è®¿é—®æ—¥å¿—æ£€æŸ¥:"
    echo "   - æ–‡ä»¶è®¿é—®è®°å½•: $(sudo ausearch -k file_access -ts this-month | grep -c "msg=audit" || echo "0")"
    echo "   - ç½‘ç»œè¿æ¥è®°å½•: $(sudo ausearch -k network_operations -ts this-month | grep -c "msg=audit" || echo "0")"
    
    # éœ€æ±‚10.2: è‡ªåŠ¨åŒ–å®¡è®¡è·Ÿè¸ª
    echo -e "\n4. å®¡è®¡ç³»ç»ŸçŠ¶æ€:"
    if systemctl is-active auditd >/dev/null 2>&1; then
        echo "   - å®¡è®¡ç³»ç»ŸçŠ¶æ€: è¿è¡Œä¸­ âœ…"
    else
        echo "   - å®¡è®¡ç³»ç»ŸçŠ¶æ€: æœªè¿è¡Œ âŒ"
    fi
    
    echo "   - å®¡è®¡è§„åˆ™æ•°é‡: $(sudo auditctl -l | wc -l)"
    echo "   - æ—¥å¿—æ–‡ä»¶å¤§å°: $(du -h /var/log/audit/audit.log 2>/dev/null | cut -f1 || echo "N/A")"
}
```

### 7.4 è‡ªåŠ¨åŒ–åˆè§„æŠ¥å‘Š


**â° å®šæ—¶æŠ¥å‘Šç”Ÿæˆ**ï¼š
```bash
# æ·»åŠ åˆ°crontabä¸­ï¼Œæ¯å‘¨ç”Ÿæˆåˆè§„æŠ¥å‘Š
# ç¼–è¾‘crontab: sudo crontab -e

# æ¯å‘¨ä¸€æ—©ä¸Š8ç‚¹ç”Ÿæˆåˆè§„æŠ¥å‘Š
0 8 * * 1 /usr/local/bin/generate_compliance_report.sh

# æ¯æœˆç¬¬ä¸€å¤©ç”Ÿæˆæœˆåº¦åˆè§„æŠ¥å‘Š  
0 9 1 * * /usr/local/bin/generate_monthly_compliance.sh
```

**ğŸ“§ æŠ¥å‘Šåˆ†å‘è„šæœ¬**ï¼š
```bash
#!/bin/bash
# åˆè§„æŠ¥å‘Šé‚®ä»¶åˆ†å‘

send_compliance_report() {
    local report_file=$1
    local recipients="admin@company.com,security@company.com"
    
    # ä½¿ç”¨mailå‘½ä»¤å‘é€æŠ¥å‘Š
    mail -s "æœˆåº¦åˆè§„å®¡è®¡æŠ¥å‘Š - $(date +%Y-%m)" \
         -a "$report_file" \
         "$recipients" << EOF
é™„ä»¶ä¸ºæœ¬æœˆçš„ç³»ç»Ÿå®¡è®¡åˆè§„æŠ¥å‘Šã€‚

ä¸»è¦å†…å®¹åŒ…æ‹¬:
- ç”¨æˆ·è®¿é—®å®¡è®¡
- ç³»ç»Ÿé…ç½®å˜æ›´
- å®‰å…¨äº‹ä»¶ç»Ÿè®¡
- åˆè§„æ€§æ£€æŸ¥ç»“æœ

å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ã€‚

ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆäº: $(date)
EOF
}
```

---

## 8. ğŸ“Š å®¡è®¡ç­–ç•¥ä¸é•¿æœŸä¿å­˜


### 8.1 å®¡è®¡ç­–ç•¥åˆ¶å®š


**ğŸ“‹ å®¡è®¡ç­–ç•¥æ¡†æ¶**ï¼š

```
å®¡è®¡ç­–ç•¥å±‚æ¬¡ç»“æ„ï¼š
ç»„ç»‡çº§ç­–ç•¥ â”€â”€â”€â”€> å®šä¹‰æ•´ä½“å®¡è®¡ç›®æ ‡å’Œè¦æ±‚
    â”‚
    â”œâ”€ æŠ€æœ¯ç­–ç•¥ â”€â”€> å…·ä½“çš„æŠ€æœ¯å®æ–½æ ‡å‡†
    â”‚
    â”œâ”€ æ“ä½œç­–ç•¥ â”€â”€> æ—¥å¸¸æ“ä½œå’Œç»´æŠ¤è§„ç¨‹
    â”‚
    â””â”€ åˆè§„ç­–ç•¥ â”€â”€> æ³•è§„éµå¾ªå’ŒæŠ¥å‘Šè¦æ±‚
```

**ğŸ¯ ç­–ç•¥åˆ¶å®šè¦ç‚¹**ï¼š
- **é£é™©è¯„ä¼°**ï¼šè¯†åˆ«éœ€è¦é‡ç‚¹ç›‘æ§çš„èµ„äº§å’Œå¨èƒ
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³é€‚ç”¨çš„æ³•è§„å’Œæ ‡å‡†
- **ä¸šåŠ¡å½±å“**ï¼šå¹³è¡¡å®‰å…¨æ€§å’Œç³»ç»Ÿæ€§èƒ½
- **èµ„æºé™åˆ¶**ï¼šè€ƒè™‘å­˜å‚¨å’Œå¤„ç†èƒ½åŠ›

### 8.2 å®¡è®¡è§„åˆ™åˆ†ç±»ç®¡ç†


**ğŸ“‚ è§„åˆ™åˆ†ç±»ä½“ç³»**ï¼š
```bash
# åˆ›å»ºåˆ†ç±»çš„å®¡è®¡è§„åˆ™ç›®å½•ç»“æ„
sudo mkdir -p /etc/audit/rules.d/{critical,normal,monitoring}

# å…³é”®å®‰å…¨è§„åˆ™ (critical)
sudo cat > /etc/audit/rules.d/critical/00-critical.rules << EOF
# å…³é”®ç³»ç»Ÿæ–‡ä»¶ç›‘æ§
-w /etc/passwd -p wa -k critical_passwd
-w /etc/shadow -p wa -k critical_shadow
-w /etc/sudoers -p wa -k critical_sudo

# ç‰¹æƒæå‡ç›‘æ§
-a always,exit -F arch=b64 -S setuid,setgid -k critical_privilege
EOF

# å¸¸è§„ç›‘æ§è§„åˆ™ (normal)  
sudo cat > /etc/audit/rules.d/normal/10-normal.rules << EOF
# æ–‡ä»¶æ“ä½œç›‘æ§
-a always,exit -F arch=b64 -S open,creat -k normal_file_ops
-a always,exit -F arch=b64 -S unlink,rename -k normal_file_ops

# è¿›ç¨‹ç›‘æ§
-a always,exit -F arch=b64 -S execve -k normal_process
EOF

# æ€§èƒ½ç›‘æ§è§„åˆ™ (monitoring)
sudo cat > /etc/audit/rules.d/monitoring/20-performance.rules << EOF
# ç³»ç»Ÿè°ƒç”¨æ€§èƒ½ç›‘æ§
-a always,exit -F arch=b64 -S connect -F success=0 -k perf_network_fail
-a always,exit -F arch=b64 -S open -F exit=-ENOENT -k perf_file_notfound
EOF
```

### 8.3 æ—¥å¿—è½®è½¬ä¸å‹ç¼©


**ğŸ”„ é«˜æ•ˆçš„æ—¥å¿—è½®è½¬é…ç½®**ï¼š
```bash
# åˆ›å»ºå®¡è®¡æ—¥å¿—è½®è½¬é…ç½®
sudo cat > /etc/logrotate.d/audit-enhanced << EOF
/var/log/audit/audit.log {
    weekly
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 0640 root root
    postrotate
        # é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶
        /sbin/service auditd restart > /dev/null 2>&1 || true
        
        # å‹ç¼©å¹¶ç§»åŠ¨æ—§æ—¥å¿—åˆ°é•¿æœŸå­˜å‚¨
        find /var/log/audit/ -name "audit.log.*" -mtime +7 -exec gzip {} \;
        find /var/log/audit/ -name "audit.log.*.gz" -mtime +30 -exec mv {} /backup/audit/ \;
    endscript
}

# å®¡è®¡ç»Ÿè®¡æ—¥å¿—è½®è½¬
/var/log/audit/audit-stats.log {
    monthly
    rotate 12
    compress
    notifempty
    create 0644 root root
}
EOF
```

### 8.4 é•¿æœŸä¿å­˜ç­–ç•¥


**ğŸ’¾ é•¿æœŸå­˜å‚¨æ¶æ„**ï¼š
```
æ—¥å¿—å­˜å‚¨ç”Ÿå‘½å‘¨æœŸï¼š
å®æ—¶æ—¥å¿— â”€â”€30å¤©â”€â”€> æœ¬åœ°å‹ç¼©å­˜å‚¨ â”€â”€1å¹´â”€â”€> å¤‡ä»½å­˜å‚¨ â”€â”€7å¹´â”€â”€> å½’æ¡£å­˜å‚¨
    â”‚                    â”‚                  â”‚                â”‚
/var/log/audit/    /backup/audit/    /archive/audit/    äº‘å­˜å‚¨/ç£å¸¦
```

**ğŸ—„ï¸ é•¿æœŸä¿å­˜è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å®¡è®¡æ—¥å¿—é•¿æœŸä¿å­˜ç®¡ç†

archive_audit_logs() {
    local current_date=$(date +%Y%m%d)
    local archive_base="/archive/audit"
    local backup_base="/backup/audit"
    
    # åˆ›å»ºå½’æ¡£ç›®å½•
    mkdir -p "$archive_base/$(date +%Y/%m)"
    
    # å‹ç¼©å¹¶ç§»åŠ¨30å¤©å‰çš„æ—¥å¿—åˆ°å½’æ¡£
    find "$backup_base" -name "audit.log.*.gz" -mtime +30 | while read logfile; do
        # æå–æ—¥æœŸä¿¡æ¯
        log_date=$(stat -c %Y "$logfile")
        archive_dir="$archive_base/$(date -d @$log_date +%Y/%m)"
        
        mkdir -p "$archive_dir"
        mv "$logfile" "$archive_dir/"
        
        echo "Archived: $logfile -> $archive_dir/"
    done
    
    # ç”Ÿæˆå½’æ¡£ç´¢å¼•
    find "$archive_base" -name "*.gz" | sort > "$archive_base/audit-index-$current_date.txt"
    
    # æ¸…ç†è¶…è¿‡7å¹´çš„å½’æ¡£æ–‡ä»¶
    find "$archive_base" -name "*.gz" -mtime +2555 -delete  # 7å¹´ = 2555å¤©
    
    echo "Archive completed: $(date)"
}

# æ¯æœˆæ‰§è¡Œå½’æ¡£
# 0 2 1 * * /usr/local/bin/archive_audit_logs.sh
```

### 8.5 å®¡è®¡æ•°æ®å¤‡ä»½ä¸æ¢å¤


**ğŸ’¾ å¤‡ä»½ç­–ç•¥å®æ–½**ï¼š
```bash
#!/bin/bash
# å®¡è®¡æ•°æ®å¤‡ä»½è„šæœ¬

backup_audit_data() {
    local backup_date=$(date +%Y%m%d_%H%M%S)
    local backup_dir="/backup/audit-backup-$backup_date"
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    mkdir -p "$backup_dir"
    
    echo "å¼€å§‹å®¡è®¡æ•°æ®å¤‡ä»½: $(date)"
    
    # å¤‡ä»½å½“å‰å®¡è®¡æ—¥å¿—
    cp -r /var/log/audit/* "$backup_dir/"
    
    # å¤‡ä»½å®¡è®¡é…ç½®
    cp -r /etc/audit/ "$backup_dir/config/"
    
    # å¤‡ä»½å®¡è®¡è§„åˆ™
    sudo auditctl -l > "$backup_dir/current-rules.txt"
    
    # å‹ç¼©å¤‡ä»½
    tar -czf "/backup/audit-backup-$backup_date.tar.gz" -C "/backup" "audit-backup-$backup_date"
    rm -rf "$backup_dir"
    
    # ç”Ÿæˆå¤‡ä»½æ ¡éªŒå’Œ
    sha256sum "/backup/audit-backup-$backup_date.tar.gz" > "/backup/audit-backup-$backup_date.sha256"
    
    echo "å¤‡ä»½å®Œæˆ: /backup/audit-backup-$backup_date.tar.gz"
    
    # æ¸…ç†7å¤©å‰çš„å¤‡ä»½
    find /backup -name "audit-backup-*.tar.gz" -mtime +7 -delete
    find /backup -name "audit-backup-*.sha256" -mtime +7 -delete
}

# æ¢å¤åŠŸèƒ½
restore_audit_data() {
    local backup_file=$1
    
    if [[ ! -f "$backup_file" ]]; then
        echo "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨: $backup_file"
        return 1
    fi
    
    # éªŒè¯æ ¡éªŒå’Œ
    sha256sum -c "${backup_file%.tar.gz}.sha256"
    if [[ $? -ne 0 ]]; then
        echo "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æ ¡éªŒå¤±è´¥"
        return 1
    fi
    
    echo "å¼€å§‹æ¢å¤å®¡è®¡æ•°æ®..."
    
    # åœæ­¢å®¡è®¡æœåŠ¡
    sudo systemctl stop auditd
    
    # æ¢å¤æ•°æ®
    tar -xzf "$backup_file" -C /tmp/
    backup_dir="/tmp/$(basename ${backup_file%.tar.gz})"
    
    # æ¢å¤æ—¥å¿—æ–‡ä»¶
    sudo cp -r "$backup_dir"/*.log /var/log/audit/
    
    # æ¢å¤é…ç½®æ–‡ä»¶
    sudo cp -r "$backup_dir/config"/* /etc/audit/
    
    # å¯åŠ¨å®¡è®¡æœåŠ¡
    sudo systemctl start auditd
    
    # æ¢å¤å®¡è®¡è§„åˆ™
    sudo auditctl -R "$backup_dir/current-rules.txt"
    
    echo "å®¡è®¡æ•°æ®æ¢å¤å®Œæˆ"
    rm -rf "$backup_dir"
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®¡è®¡ç³»ç»Ÿæœ¬è´¨ï¼šLinuxç³»ç»Ÿå®‰å…¨ç›‘æ§å’Œåˆè§„ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶
ğŸ”¸ auditdæ¶æ„ï¼šå†…æ ¸æ¨¡å—+å®ˆæŠ¤è¿›ç¨‹+ç”¨æˆ·ç©ºé—´å·¥å…·çš„å®Œæ•´ä½“ç³»  
ğŸ”¸ å®¡è®¡è§„åˆ™ï¼šé€šè¿‡auditctlé…ç½®ç›‘æ§èŒƒå›´å’Œè¿‡æ»¤æ¡ä»¶
ğŸ”¸ æ—¥å¿—åˆ†æï¼šä½¿ç”¨ausearchå’Œaureportè¿›è¡Œäº‹ä»¶æŸ¥è¯¢å’ŒæŠ¥å‘Šç”Ÿæˆ
ğŸ”¸ åˆè§„ç®¡ç†ï¼šæ»¡è¶³SOXã€PCI DSSç­‰æ³•è§„è¦æ±‚çš„å®¡è®¡è®°å½•
ğŸ”¸ é•¿æœŸä¿å­˜ï¼šæ—¥å¿—è½®è½¬ã€å‹ç¼©ã€å½’æ¡£çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®¡è®¡ç³»ç»Ÿçš„ä»·å€¼**ï¼š
```
å®‰å…¨é˜²æŠ¤ï¼š
- æ£€æµ‹å…¥ä¾µè¡Œä¸ºå’Œå¼‚å¸¸æ“ä½œ
- è¿½è¸ªå®‰å…¨äº‹ä»¶çš„å®Œæ•´è¿‡ç¨‹
- æä¾›äº‹ååˆ†æçš„è¯¦ç»†è¯æ®

åˆè§„è¦æ±‚ï¼š
- æ»¡è¶³æ³•è§„å’Œæ ‡å‡†çš„å®¡è®¡è¦æ±‚
- ç”Ÿæˆå¯ä¿¡çš„åˆè§„æŠ¥å‘Š
- æ”¯æŒå®¡è®¡å¸ˆçš„æ£€æŸ¥å·¥ä½œ

è¿ç»´ç®¡ç†ï¼š
- ç›‘æ§ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§
- åˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼
- è¾…åŠ©æ•…éšœæ’æŸ¥å’Œä¼˜åŒ–
```

**ğŸ”¹ æ€§èƒ½ä¸å®‰å…¨çš„å¹³è¡¡**ï¼š
```
å…³é”®è€ƒè™‘ï¼š
- å®¡è®¡èŒƒå›´ï¼šç›‘æ§é‡è¦äº‹ä»¶ï¼Œé¿å…è¿‡åº¦ç›‘æ§
- è§„åˆ™ä¼˜åŒ–ï¼šç²¾ç¡®è¿‡æ»¤ï¼Œå‡å°‘æ— ç”¨è®°å½•
- å­˜å‚¨ç®¡ç†ï¼šåŠæ—¶è½®è½¬ï¼Œé¿å…ç£ç›˜æ»¡
- ç³»ç»Ÿå½±å“ï¼šè¯„ä¼°æ€§èƒ½å¼€é”€ï¼Œåˆç†é…ç½®
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… æœ€ä½³å®è·µæ¸…å•**ï¼š
```
é…ç½®é˜¶æ®µï¼š
â–¡ æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ¶å®šå®¡è®¡ç­–ç•¥
â–¡ åˆ†ç±»ç®¡ç†å®¡è®¡è§„åˆ™
â–¡ é…ç½®åˆç†çš„æ—¥å¿—è½®è½¬ç­–ç•¥
â–¡ è®¾ç½®ç£ç›˜ç©ºé—´ç›‘æ§å‘Šè­¦

è¿ç»´é˜¶æ®µï¼š
â–¡ å®šæœŸæ£€æŸ¥å®¡è®¡ç³»ç»ŸçŠ¶æ€  
â–¡ ç›‘æ§æ—¥å¿—æ–‡ä»¶å¤§å°å’Œç£ç›˜ä½¿ç”¨
â–¡ å®šæœŸç”Ÿæˆå’Œå®¡é˜…å®‰å…¨æŠ¥å‘Š
â–¡ æµ‹è¯•å¤‡ä»½å’Œæ¢å¤ç¨‹åº

åˆ†æé˜¶æ®µï¼š
â–¡ æŒæ¡ausearchå’Œaureportçš„ä½¿ç”¨
â–¡ å»ºç«‹å¼‚å¸¸äº‹ä»¶çš„å¤„ç†æµç¨‹
â–¡ åˆ›å»ºè‡ªåŠ¨åŒ–åˆ†æå’Œå‘Šè­¦æœºåˆ¶
â–¡ ç»´æŠ¤åˆè§„æŠ¥å‘Šçš„ç”Ÿæˆæµç¨‹
```

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³**ï¼š
```
æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼š
â†’ è°ƒæ•´max_log_fileå‚æ•°
â†’ ä¼˜åŒ–å®¡è®¡è§„åˆ™ï¼Œå‡å°‘æ— å…³è®°å½•
â†’ åŠæ—¶è®¾ç½®æ—¥å¿—è½®è½¬

ç³»ç»Ÿæ€§èƒ½å½±å“ï¼š
â†’ é¿å…ç›‘æ§é«˜é¢‘ç³»ç»Ÿè°ƒç”¨
â†’ ä½¿ç”¨è¿‡æ»¤æ¡ä»¶ç²¾ç¡®ç›‘æ§
â†’ ç›‘æ§CPUå’Œç£ç›˜I/Oå½±å“

è§„åˆ™ç®¡ç†æ··ä¹±ï¼š
â†’ å»ºç«‹è§„åˆ™åˆ†ç±»ä½“ç³»
â†’ ä½¿ç”¨æè¿°æ€§çš„å…³é”®å­—æ ‡ç­¾
â†’ å®šæœŸæ¸…ç†æ— ç”¨è§„åˆ™
```

### 9.4 å­¦ä¹ è·¯å¾„å»ºè®®


```
ğŸ¯ **å­¦ä¹ é˜¶æ®µè§„åˆ’**

ğŸŸ¢ åŸºç¡€é˜¶æ®µï¼š
- ç†è§£å®¡è®¡ç³»ç»Ÿçš„ä½œç”¨å’ŒåŸç†
- æŒæ¡auditdçš„å®‰è£…å’ŒåŸºæœ¬é…ç½®
- å­¦ä¼šä½¿ç”¨ausearchå’Œaureport

ğŸŸ¡ è¿›é˜¶é˜¶æ®µï¼š
- ç†Ÿç»ƒé…ç½®å„ç±»å®¡è®¡è§„åˆ™
- æŒæ¡ç³»ç»Ÿè°ƒç”¨å’Œæ–‡ä»¶ç›‘æ§
- èƒ½å¤Ÿåˆ†æå®¡è®¡æ—¥å¿—å’Œç”ŸæˆæŠ¥å‘Š

ğŸ”´ é«˜çº§é˜¶æ®µï¼š
- åˆ¶å®šå®Œæ•´çš„å®¡è®¡ç­–ç•¥
- å®ç°è‡ªåŠ¨åŒ–åˆè§„ç®¡ç†
- å»ºç«‹ä¼ä¸šçº§å®¡è®¡ç›‘æ§ä½“ç³»
```

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- **auditdæ˜¯å®ˆæŠ¤ç¥**ï¼šæ—¶åˆ»ç›‘æ§ç³»ç»Ÿå®‰å…¨äº‹ä»¶
- **è§„åˆ™è¦ç²¾å‡†**ï¼šç›‘æ§é‡ç‚¹ï¼Œé¿å…æ€§èƒ½å½±å“  
- **æ—¥å¿—è¦ç®¡ç†**ï¼šè½®è½¬å‹ç¼©ï¼Œé•¿æœŸä¿å­˜
- **åˆ†æè¦åŠæ—¶**ï¼šå‘ç°å¼‚å¸¸ï¼Œå¿«é€Ÿå“åº”
- **åˆè§„è¦æŒç»­**ï¼šå®šæœŸæŠ¥å‘Šï¼Œæ»¡è¶³è¦æ±‚

**ğŸ”— å»¶ä¼¸å­¦ä¹ **ï¼š
- ELK Stacké›†æˆï¼šå°†å®¡è®¡æ—¥å¿—é›†æˆåˆ°Elasticsearchè¿›è¡Œå¤§æ•°æ®åˆ†æ
- SIEMç³»ç»Ÿï¼šå°†å®¡è®¡æ•°æ®é›†æˆåˆ°å®‰å…¨ä¿¡æ¯äº‹ä»¶ç®¡ç†ç³»ç»Ÿ
- äº‘å¹³å°å®¡è®¡ï¼šAWS CloudTrailã€Azure Monitorç­‰äº‘åŸç”Ÿå®¡è®¡æœåŠ¡
- å®¹å™¨å®¡è®¡ï¼šDockerå’ŒKubernetesç¯å¢ƒçš„å®¡è®¡ç›‘æ§