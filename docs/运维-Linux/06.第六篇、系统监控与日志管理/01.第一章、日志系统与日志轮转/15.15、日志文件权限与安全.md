---
title: 15ã€æ—¥å¿—æ–‡ä»¶æƒé™ä¸å®‰å…¨
---
## ğŸ“š ç›®å½•

1. [æ—¥å¿—æ–‡ä»¶æƒé™è®¾ç½®](#1-æ—¥å¿—æ–‡ä»¶æƒé™è®¾ç½®)
2. [æ—¥å¿—ç›®å½•è®¿é—®æ§åˆ¶](#2-æ—¥å¿—ç›®å½•è®¿é—®æ§åˆ¶)
3. [æ—¥å¿—å®Œæ•´æ€§ä¿æŠ¤](#3-æ—¥å¿—å®Œæ•´æ€§ä¿æŠ¤)
4. [é˜²ç¯¡æ”¹æœºåˆ¶è®¾è®¡](#4-é˜²ç¯¡æ”¹æœºåˆ¶è®¾è®¡)
5. [æ—¥å¿—åŠ å¯†å­˜å‚¨](#5-æ—¥å¿—åŠ å¯†å­˜å‚¨)
6. [æ•æ„Ÿä¿¡æ¯è¿‡æ»¤](#6-æ•æ„Ÿä¿¡æ¯è¿‡æ»¤)
7. [æ—¥å¿—å¤‡ä»½å®‰å…¨](#7-æ—¥å¿—å¤‡ä»½å®‰å…¨)
8. [æ³•è§„åˆè§„è¦æ±‚](#8-æ³•è§„åˆè§„è¦æ±‚)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æ—¥å¿—æ–‡ä»¶æƒé™è®¾ç½®


### 1.1 ä¸ºä»€ä¹ˆæ—¥å¿—æƒé™è¿™ä¹ˆé‡è¦ï¼Ÿ


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æ—¥å¿—å°±åƒä½ å®¶çš„ç›‘æ§å½•åƒï¼Œé‡Œé¢è®°å½•äº†æ‰€æœ‰é‡è¦äº‹ä»¶ã€‚å¦‚æœä»»ä½•äººéƒ½èƒ½æŸ¥çœ‹ã€ä¿®æ”¹æˆ–åˆ é™¤è¿™äº›å½•åƒï¼Œé‚£å®‰å…¨ç›‘æ§å°±å¤±å»äº†æ„ä¹‰ã€‚

**æ ¸å¿ƒé—®é¢˜**ï¼š
- æ—¥å¿—åŒ…å«ç³»ç»Ÿè¿è¡Œçš„æ•æ„Ÿä¿¡æ¯
- æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹æ—¥å¿—éšè—å…¥ä¾µç—•è¿¹
- é”™è¯¯çš„æƒé™è®¾ç½®å¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²

### 1.2 åŸºæœ¬æƒé™åŸåˆ™


**ğŸ¯ æœ€å°æƒé™åŸåˆ™**
```
æƒé™åˆ†é…åŸåˆ™ï¼š
åªè¯»åŸåˆ™ï¼šå¤§éƒ¨åˆ†ç”¨æˆ·åªèƒ½è¯»å–è‡ªå·±ç›¸å…³çš„æ—¥å¿—
å†™å…¥æ§åˆ¶ï¼šåªæœ‰ç³»ç»Ÿè¿›ç¨‹å’Œç®¡ç†å‘˜èƒ½å†™å…¥
åˆ é™¤é™åˆ¶ï¼šæ™®é€šç”¨æˆ·ç»å¯¹ä¸èƒ½åˆ é™¤æ—¥å¿—æ–‡ä»¶
```

**ğŸ“Š æƒé™ç­‰çº§åˆ’åˆ†**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¶…çº§ç®¡ç†å‘˜     â”‚ â† å®Œå…¨è®¿é—®æƒé™ (root)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç³»ç»Ÿç®¡ç†å‘˜     â”‚ â† è¯»å†™æŒ‡å®šæ—¥å¿— (syslog group)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº”ç”¨ç®¡ç†å‘˜     â”‚ â† è¯»å†™åº”ç”¨æ—¥å¿— (app group)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ™®é€šç”¨æˆ·       â”‚ â† åªè¯»éƒ¨åˆ†æ—¥å¿— (user)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ–‡ä»¶æƒé™å®è·µé…ç½®


**ğŸ”§ åŸºæœ¬æƒé™è®¾ç½®**
```bash
# ç³»ç»Ÿæ—¥å¿—ç›®å½•æƒé™
sudo chmod 755 /var/log                    # ç›®å½•å¯è¿›å…¥ï¼Œæ–‡ä»¶éœ€è¦é¢å¤–æƒé™
sudo chmod 640 /var/log/messages           # ç®¡ç†å‘˜å¯è¯»å†™ï¼Œç»„ç”¨æˆ·åªè¯»
sudo chmod 600 /var/log/secure            # åªæœ‰rootèƒ½è®¿é—®å®‰å…¨æ—¥å¿—

# åº”ç”¨æ—¥å¿—æƒé™ç¤ºä¾‹
sudo chmod 644 /var/log/httpd/access.log  # WebæœåŠ¡å™¨è®¿é—®æ—¥å¿—
sudo chmod 640 /var/log/httpd/error.log   # é”™è¯¯æ—¥å¿—é™åˆ¶æ›´ä¸¥æ ¼
```

**ğŸ’¡ æƒé™æ•°å­—å«ä¹‰è§£é‡Š**
```
æƒé™æ•°å­—è§£è¯»ï¼š
755 = rwxr-xr-x (æ‰€æœ‰è€…ï¼šè¯»å†™æ‰§è¡Œï¼Œç»„å’Œå…¶ä»–ï¼šè¯»æ‰§è¡Œ)
644 = rw-r--r-- (æ‰€æœ‰è€…ï¼šè¯»å†™ï¼Œç»„å’Œå…¶ä»–ï¼šåªè¯»)
640 = rw-r----- (æ‰€æœ‰è€…ï¼šè¯»å†™ï¼Œç»„ï¼šåªè¯»ï¼Œå…¶ä»–ï¼šæ— æƒé™)
600 = rw------- (åªæœ‰æ‰€æœ‰è€…èƒ½è¯»å†™)
```

### 1.4 ç‰¹æ®Šæƒé™è®¾ç½®


**ğŸ”’ ç²˜è´´ä½(Sticky Bit)**
```bash
# ä¸ºæ—¥å¿—ç›®å½•è®¾ç½®ç²˜è´´ä½ï¼Œé˜²æ­¢ç”¨æˆ·åˆ é™¤ä»–äººæ–‡ä»¶
sudo chmod +t /tmp/logs
sudo chmod 1755 /tmp/logs  # ç­‰æ•ˆå†™æ³•

# æ£€æŸ¥ç²˜è´´ä½
ls -ld /tmp/logs
# è¾“å‡ºç¤ºä¾‹ï¼šdrwxr-xr-t 2 root root 4096 Jan 1 12:00 /tmp/logs
```

**ğŸ›¡ï¸ æ‰©å±•å±æ€§ä¿æŠ¤**
```bash
# ä½¿ç”¨chattrå‘½ä»¤å¢å¼ºä¿æŠ¤
sudo chattr +a /var/log/audit/audit.log    # åªèƒ½è¿½åŠ ï¼Œä¸èƒ½ä¿®æ”¹
sudo chattr +i /var/log/critical.log       # å®Œå…¨ä¸å¯ä¿®æ”¹

# æŸ¥çœ‹æ‰©å±•å±æ€§
lsattr /var/log/audit/audit.log
# è¾“å‡ºç¤ºä¾‹ï¼š-----a------- /var/log/audit/audit.log

# ç§»é™¤æ‰©å±•å±æ€§ï¼ˆéœ€è¦æ—¶ï¼‰
sudo chattr -a /var/log/audit/audit.log
```

---

## 2. ğŸ“ æ—¥å¿—ç›®å½•è®¿é—®æ§åˆ¶


### 2.1 ç›®å½•ç»“æ„è®¾è®¡


**ğŸ—ï¸ åˆç†çš„ç›®å½•å±‚æ¬¡**
```
/var/log/
â”œâ”€â”€ system/          # ç³»ç»Ÿçº§æ—¥å¿— (æƒé™ï¼š750, root:syslog)
â”‚   â”œâ”€â”€ kernel.log
â”‚   â”œâ”€â”€ boot.log
â”‚   â””â”€â”€ hardware.log
â”œâ”€â”€ services/        # æœåŠ¡æ—¥å¿— (æƒé™ï¼š755, root:adm)
â”‚   â”œâ”€â”€ apache2/
â”‚   â”œâ”€â”€ mysql/
â”‚   â””â”€â”€ ssh/
â”œâ”€â”€ applications/    # åº”ç”¨æ—¥å¿— (æƒé™ï¼š775, root:applog)
â”‚   â”œâ”€â”€ webapp1/
â”‚   â”œâ”€â”€ webapp2/
â”‚   â””â”€â”€ monitoring/
â””â”€â”€ security/        # å®‰å…¨æ—¥å¿— (æƒé™ï¼š700, root:root)
    â”œâ”€â”€ auth.log
    â”œâ”€â”€ fail2ban.log
    â””â”€â”€ intrusion.log
```

### 2.2 ç”¨æˆ·ç»„ç®¡ç†


**ğŸ‘¥ åˆ›å»ºä¸“ç”¨æ—¥å¿—ç»„**
```bash
# åˆ›å»ºæ—¥å¿—ç®¡ç†ç›¸å…³çš„ç”¨æˆ·ç»„
sudo groupadd syslog-readers    # ç³»ç»Ÿæ—¥å¿—è¯»å–ç»„
sudo groupadd app-loggers       # åº”ç”¨æ—¥å¿—ç®¡ç†ç»„
sudo groupadd security-admins   # å®‰å…¨æ—¥å¿—ç®¡ç†ç»„

# å°†ç”¨æˆ·æ·»åŠ åˆ°ç›¸åº”ç»„
sudo usermod -a -G syslog-readers alice     # aliceå¯ä»¥è¯»å–ç³»ç»Ÿæ—¥å¿—
sudo usermod -a -G app-loggers bob          # bobå¯ä»¥ç®¡ç†åº”ç”¨æ—¥å¿—
sudo usermod -a -G security-admins charlie  # charlieå¯ä»¥ç®¡ç†å®‰å…¨æ—¥å¿—
```

**ğŸ” ç»„æƒé™åˆ†é…ç¤ºä¾‹**
```bash
# è®¾ç½®ä¸åŒç›®å½•çš„ç»„æƒé™
sudo chgrp syslog-readers /var/log/system/
sudo chmod g+r /var/log/system/*.log

sudo chgrp app-loggers /var/log/applications/
sudo chmod g+rw /var/log/applications/*.log

sudo chgrp security-admins /var/log/security/
sudo chmod g+r /var/log/security/*.log
```

### 2.3 ACLè®¿é—®æ§åˆ¶åˆ—è¡¨


**âš¡ ä½¿ç”¨ACLå®ç°ç²¾ç»†æ§åˆ¶**
```bash
# å®‰è£…ACLå·¥å…·
sudo apt-get install acl

# ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®æ—¥å¿—è®¿é—®æƒé™
sudo setfacl -m u:developer:r /var/log/applications/webapp.log
sudo setfacl -m g:monitoring:r /var/log/system/performance.log

# è®¾ç½®é»˜è®¤ACLï¼ˆæ–°æ–‡ä»¶è‡ªåŠ¨ç»§æ‰¿ï¼‰
sudo setfacl -d -m g:syslog-readers:r /var/log/system/

# æŸ¥çœ‹ACLæƒé™
getfacl /var/log/applications/webapp.log
```

**ğŸ“‹ ACLæƒé™ç¤ºä¾‹è¾“å‡º**
```
# file: /var/log/applications/webapp.log
# owner: root
# group: app-loggers
user::rw-
user:developer:r--
group::r--
group:monitoring:r--
mask::r--
other::---
```

---

## 3. ğŸ›¡ï¸ æ—¥å¿—å®Œæ•´æ€§ä¿æŠ¤


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦å®Œæ•´æ€§ä¿æŠ¤ï¼Ÿ


**ğŸ¯ æ ¸å¿ƒé—®é¢˜**
- **æ”»å‡»è€…éšè—ç—•è¿¹**ï¼šåˆ é™¤æˆ–ä¿®æ”¹å…¥ä¾µæ—¥å¿—
- **å†…éƒ¨å¨èƒ**ï¼šæ¶æ„ç®¡ç†å‘˜ç¯¡æ”¹å®¡è®¡è®°å½•
- **æ„å¤–æŸå**ï¼šç¡¬ä»¶æ•…éšœæˆ–è¯¯æ“ä½œå¯¼è‡´æ—¥å¿—ä¸¢å¤±

**ğŸ’¡ å®Œæ•´æ€§ä¿æŠ¤ç›®æ ‡**
```
æ£€æµ‹ç¯¡æ”¹ï¼šèƒ½å¤Ÿå‘ç°æ—¥å¿—æ˜¯å¦è¢«ä¿®æ”¹
é˜²æ­¢åˆ é™¤ï¼šé˜»æ­¢æœªæˆæƒçš„æ—¥å¿—åˆ é™¤
è¯æ˜åŸå§‹æ€§ï¼šè¯æ˜æ—¥å¿—çš„çœŸå®æ€§å’Œæ—¶æ•ˆæ€§
```

### 3.2 æ–‡ä»¶å“ˆå¸Œæ ¡éªŒ


**ğŸ” ä½¿ç”¨å“ˆå¸Œå€¼æ£€æµ‹ç¯¡æ”¹**
```bash
# ä¸ºé‡è¦æ—¥å¿—ç”Ÿæˆå“ˆå¸Œå€¼
sudo md5sum /var/log/auth.log > /var/log/checksums/auth.log.md5
sudo sha256sum /var/log/audit/audit.log > /var/log/checksums/audit.log.sha256

# å®šæœŸæ ¡éªŒè„šæœ¬ç¤ºä¾‹
#!/bin/bash
LOG_DIR="/var/log"
CHECKSUM_DIR="/var/log/checksums"

check_integrity() {
    local log_file=$1
    local checksum_file="${CHECKSUM_DIR}/$(basename $log_file).sha256"
    
    if [ -f "$checksum_file" ]; then
        cd $(dirname $log_file)
        if sha256sum -c "$checksum_file" --quiet; then
            echo "âœ… $log_file: å®Œæ•´æ€§éªŒè¯é€šè¿‡"
        else
            echo "âŒ $log_file: æ£€æµ‹åˆ°ç¯¡æ”¹ï¼"
            # å‘é€å‘Šè­¦é€šçŸ¥
            send_alert "æ—¥å¿—æ–‡ä»¶ $log_file å¯èƒ½è¢«ç¯¡æ”¹"
        fi
    fi
}
```

### 3.3 å®æ—¶ç›‘æ§ä¸å‘Šè­¦


**ğŸ‘ï¸ ä½¿ç”¨inotifyç›‘æ§æ–‡ä»¶å˜åŒ–**
```bash
# å®‰è£…inotifyå·¥å…·
sudo apt-get install inotify-tools

# ç›‘æ§æ—¥å¿—ç›®å½•çš„æ–‡ä»¶å˜åŒ–
#!/bin/bash
LOG_DIRS="/var/log/auth.log /var/log/audit/ /var/log/secure"

inotifywait -m -r -e modify,delete,move $LOG_DIRS --format '%w%f %e %T' --timefmt '%Y-%m-%d %H:%M:%S' | \
while read file event time; do
    echo "[$time] æ–‡ä»¶å˜åŒ–: $file -> $event"
    
    # å¦‚æœæ˜¯é‡è¦æ—¥å¿—è¢«ä¿®æ”¹ï¼Œç«‹å³å¤‡ä»½
    if [[ "$file" =~ (auth\.log|audit\.log|secure) ]]; then
        cp "$file" "/var/log/backups/$(basename $file)_$(date +%Y%m%d_%H%M%S)"
        echo "å·²åˆ›å»ºå¤‡ä»½: $file"
    fi
done
```

### 3.4 æ•°å­—ç­¾åä¿æŠ¤


**ğŸ” ä½¿ç”¨GPGç­¾åä¿æŠ¤**
```bash
# ç”ŸæˆGPGå¯†é’¥å¯¹ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
gpg --gen-key

# å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œæ•°å­—ç­¾å
gpg --armor --detach-sign /var/log/audit/audit.log
# ç”Ÿæˆaudit.log.ascç­¾åæ–‡ä»¶

# éªŒè¯ç­¾å
gpg --verify /var/log/audit/audit.log.asc /var/log/audit/audit.log

# è‡ªåŠ¨ç­¾åè„šæœ¬
#!/bin/bash
sign_log() {
    local log_file=$1
    if [ -f "$log_file" ]; then
        gpg --quiet --armor --detach-sign "$log_file"
        echo "å·²ç­¾å: $log_file"
    fi
}
```

---

## 4. ğŸ”’ é˜²ç¯¡æ”¹æœºåˆ¶è®¾è®¡


### 4.1 å†™å…¥ä¿æŠ¤ç­–ç•¥


**ğŸ“ åªè¿½åŠ æ¨¡å¼**
```bash
# è®¾ç½®æ–‡ä»¶ä¸ºåªè¿½åŠ æ¨¡å¼
sudo chattr +a /var/log/auth.log

# é…ç½®rsyslogåªè¿½åŠ å†™å…¥
# åœ¨/etc/rsyslog.confä¸­
$FileCreateMode 0640
$DirCreateMode 0755
$Umask 0022

# é’ˆå¯¹ç‰¹å®šæ—¥å¿—æ–‡ä»¶
auth,authpriv.*    /var/log/auth.log;RSYSLOG_TraditionalFileFormat
```

**â° å®šæ—¶é”å®šæœºåˆ¶**
```bash
#!/bin/bash
# æ—¥å¿—å®šæ—¶é”å®šè„šæœ¬
LOCK_DELAY=3600  # 1å°æ—¶åé”å®š

lock_old_logs() {
    # æ‰¾åˆ°1å°æ—¶å‰çš„æ—¥å¿—æ–‡ä»¶å¹¶è®¾ç½®ä¸ºä¸å¯ä¿®æ”¹
    find /var/log -name "*.log" -mmin +60 -exec chattr +i {} \;
    echo "å·²é”å®š1å°æ—¶å‰çš„æ—¥å¿—æ–‡ä»¶"
}

# æ·»åŠ åˆ°crontab
# 0 * * * * /usr/local/bin/lock_old_logs.sh
```

### 4.2 åˆ†å¸ƒå¼å­˜å‚¨ä¿æŠ¤


**ğŸŒ è¿œç¨‹æ—¥å¿—å¤‡ä»½**
```bash
# é…ç½®rsyslogè¿œç¨‹ä¼ è¾“
# åœ¨/etc/rsyslog.confä¸­æ·»åŠ 
*.* $$remote-log-server:514

# ä½¿ç”¨TLSåŠ å¯†ä¼ è¾“
$DefaultNetstreamDriver gtls
$DefaultNetstreamDriverCAFile /etc/ssl/rsyslog/ca.pem
$DefaultNetstreamDriverCertFile /etc/ssl/rsyslog/client-cert.pem
$DefaultNetstreamDriverKeyFile /etc/ssl/rsyslog/client-key.pem
$ActionSendStreamDriverAuthMode x509/name
*.* $$secure-log-server:6514
```

**ğŸ’¾ å¤šå‰¯æœ¬å­˜å‚¨**
```bash
#!/bin/bash
# æ—¥å¿—å¤šå‰¯æœ¬åŒæ­¥è„šæœ¬
LOG_SOURCES="/var/log/auth.log /var/log/audit/audit.log"
BACKUP_LOCATIONS=(
    "/backup/logs/local"
    "user@backup-server-1:/backup/logs/"
    "user@backup-server-2:/backup/logs/"
)

sync_logs() {
    for source in $LOG_SOURCES; do
        for dest in "${BACKUP_LOCATIONS[@]}"; do
            if [[ "$dest" =~ @ ]]; then
                # è¿œç¨‹åŒæ­¥
                rsync -av --append-verify "$source" "$dest"
            else
                # æœ¬åœ°åŒæ­¥
                cp --preserve=timestamps "$source" "$dest/"
            fi
        done
    done
}
```

### 4.3 ç‰ˆæœ¬æ§åˆ¶ä¿æŠ¤


**ğŸ“š Gitç‰ˆæœ¬æ§åˆ¶**
```bash
# åˆå§‹åŒ–æ—¥å¿—ç‰ˆæœ¬æ§åˆ¶
cd /var/log
sudo git init
sudo git config user.name "Log System"
sudo git config user.email "logs@company.com"

# æ·»åŠ é‡è¦æ—¥å¿—åˆ°ç‰ˆæœ¬æ§åˆ¶
sudo git add auth.log audit/audit.log secure
sudo git commit -m "Initial log commit $(date)"

# å®šæœŸæäº¤å˜æ›´
#!/bin/bash
cd /var/log
if [ -n "$(git status --porcelain)" ]; then
    git add -A
    git commit -m "Log update $(date '+%Y-%m-%d %H:%M:%S')"
    echo "æ—¥å¿—å˜æ›´å·²æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶"
fi
```

---

## 5. ğŸ” æ—¥å¿—åŠ å¯†å­˜å‚¨


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦åŠ å¯†ï¼Ÿ


**ğŸ” æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**
```
æ—¥å¿—ä¸­çš„æ•æ„Ÿæ•°æ®ï¼š
- ç”¨æˆ·å¯†ç å°è¯•è®°å½•
- IPåœ°å€å’Œç½‘ç»œæ‹“æ‰‘ä¿¡æ¯  
- ç³»ç»Ÿæ¼æ´å’Œé”™è¯¯è¯¦æƒ…
- ä¸šåŠ¡æµç¨‹å’Œæ•°æ®è®¿é—®æ¨¡å¼
```

**ğŸ¯ åŠ å¯†ç›®æ ‡**
- **å­˜å‚¨åŠ å¯†**ï¼šé™æ€æ•°æ®ä¿æŠ¤
- **ä¼ è¾“åŠ å¯†**ï¼šç½‘ç»œä¼ è¾“å®‰å…¨
- **è®¿é—®åŠ å¯†**ï¼šè¯»å–æ—¶è§£å¯†éªŒè¯

### 5.2 æ–‡ä»¶çº§åŠ å¯†


**ğŸ”’ ä½¿ç”¨GPGåŠ å¯†æ—¥å¿—**
```bash
# å‹ç¼©å¹¶åŠ å¯†æ—§æ—¥å¿—
gzip /var/log/auth.log.1
gpg --cipher-algo AES256 --compress-algo 2 --symmetric --output /var/log/encrypted/auth.log.1.gz.gpg /var/log/auth.log.1.gz

# è§£å¯†æŸ¥çœ‹
gpg --quiet --decrypt /var/log/encrypted/auth.log.1.gz.gpg | gunzip | less

# è‡ªåŠ¨åŠ å¯†è„šæœ¬
#!/bin/bash
encrypt_old_logs() {
    local log_dir="/var/log"
    local encrypted_dir="/var/log/encrypted"
    
    # æ‰¾åˆ°7å¤©å‰çš„æ—¥å¿—æ–‡ä»¶
    find "$log_dir" -name "*.log.*" -mtime +7 | while read log_file; do
        echo "åŠ å¯†æ–‡ä»¶: $log_file"
        gzip "$log_file"
        gpg --quiet --symmetric --cipher-algo AES256 \
            --output "$encrypted_dir/$(basename $log_file).gz.gpg" \
            "$log_file.gz"
        
        # éªŒè¯åŠ å¯†æˆåŠŸååˆ é™¤åŸæ–‡ä»¶
        if [ $? -eq 0 ]; then
            rm "$log_file.gz"
            echo "âœ… å·²åŠ å¯†å¹¶åˆ é™¤åŸæ–‡ä»¶: $log_file"
        fi
    done
}
```

### 5.3 ç£ç›˜çº§åŠ å¯†


**ğŸ’½ LUKSç£ç›˜åŠ å¯†**
```bash
# åˆ›å»ºåŠ å¯†åˆ†åŒºç”¨äºæ—¥å¿—å­˜å‚¨
sudo cryptsetup luksFormat /dev/sdb1
sudo cryptsetup luksOpen /dev/sdb1 encrypted-logs

# æ ¼å¼åŒ–å¹¶æŒ‚è½½
sudo mkfs.ext4 /dev/mapper/encrypted-logs
sudo mkdir /var/log/encrypted
sudo mount /dev/mapper/encrypted-logs /var/log/encrypted

# é…ç½®è‡ªåŠ¨æŒ‚è½½ï¼ˆéœ€è¦å¯†é’¥æ–‡ä»¶ï¼‰
echo "encrypted-logs /dev/sdb1 /etc/luks/keyfile luks" >> /etc/crypttab
echo "/dev/mapper/encrypted-logs /var/log/encrypted ext4 defaults 0 2" >> /etc/fstab
```

### 5.4 æµå¼åŠ å¯†


**âš¡ å®æ—¶åŠ å¯†å†™å…¥**
```bash
#!/bin/bash
# ä½¿ç”¨å‘½åç®¡é“å®ç°æµå¼åŠ å¯†
FIFO="/tmp/encrypted_log.fifo"
ENCRYPTED_LOG="/var/log/encrypted/stream.log.gpg"

# åˆ›å»ºå‘½åç®¡é“
mkfifo "$FIFO"

# å¯åŠ¨åŠ å¯†è¿›ç¨‹
gpg --quiet --symmetric --cipher-algo AES256 < "$FIFO" > "$ENCRYPTED_LOG" &
ENCRYPT_PID=$!

# åº”ç”¨ç¨‹åºå†™å…¥ç®¡é“
echo "$(date): Application started" > "$FIFO"
echo "$(date): User login: alice" > "$FIFO"

# æ¸…ç†
kill $ENCRYPT_PID
rm "$FIFO"
```

---

## 6. ğŸ­ æ•æ„Ÿä¿¡æ¯è¿‡æ»¤


### 6.1 è¯†åˆ«æ•æ„Ÿä¿¡æ¯


**ğŸ” å¸¸è§æ•æ„Ÿä¿¡æ¯ç±»å‹**
```
ä¸ªäººä¿¡æ¯ï¼š
- èº«ä»½è¯å·ç : \d{15}|\d{18}
- æ‰‹æœºå·ç : 1[3-9]\d{9}
- é‚®ç®±åœ°å€: \S+@\S+\.\S+

å®‰å…¨ä¿¡æ¯ï¼š
- å¯†ç å­—æ®µ: password=\S+
- APIå¯†é’¥: api[_-]?key['"]\s*[:=]\s*['"]?\S+
- JWTä»¤ç‰Œ: eyJ[A-Za-z0-9_/+-]*\.eyJ[A-Za-z0-9_/+-]*\.[A-Za-z0-9_/+-]*

ç³»ç»Ÿä¿¡æ¯ï¼š
- å†…ç½‘IP: 192\.168\.\d+\.\d+|10\.\d+\.\d+\.\d+
- æ–‡ä»¶è·¯å¾„: /[a-zA-Z0-9_/.-]+
- æ•°æ®åº“è¿æ¥ä¸²: \w+://\S+:\S+@\S+
```

### 6.2 å®æ—¶è¿‡æ»¤é…ç½®


**ğŸ”§ rsyslogè¿‡æ»¤è§„åˆ™**
```bash
# åœ¨/etc/rsyslog.d/50-privacy.confä¸­é…ç½®
# è¿‡æ»¤å¯†ç ä¿¡æ¯
:msg, regex, "password=[^[:space:]]+" stop

# è¿‡æ»¤èº«ä»½è¯å·
:msg, regex, "[0-9]{15}|[0-9]{18}" stop

# æ›¿æ¢æ•æ„ŸIPåœ°å€
$template PrivacyTemplate,"%timestamp% %hostname% %syslogtag% %msg:1:2048:replace:192.168:XXX.XXX%\n"

# åº”ç”¨æ¨¡æ¿
*.* /var/log/filtered.log;PrivacyTemplate
```

**âš¡ å®æ—¶è¿‡æ»¤è„šæœ¬**
```bash
#!/bin/bash
# æ—¥å¿—æ•æ„Ÿä¿¡æ¯è¿‡æ»¤å™¨

filter_sensitive_data() {
    local input_log=$1
    local output_log=$2
    
    # ä½¿ç”¨sedè¿›è¡Œå¤šé‡æ›¿æ¢
    sed -E \
        -e 's/password=[^[:space:]]*/password=***FILTERED***/g' \
        -e 's/[0-9]{15}|[0-9]{18}/***ID_FILTERED***/g' \
        -e 's/1[3-9][0-9]{9}/***PHONE_FILTERED***/g' \
        -e 's/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/***EMAIL_FILTERED***/g' \
        "$input_log" > "$output_log"
}

# ç›‘æ§å¹¶è¿‡æ»¤æ–°å¢æ—¥å¿—
tail -F /var/log/application.log | while read line; do
    filtered_line=$(echo "$line" | sed -E 's/password=[^[:space:]]*/password=***FILTERED***/g')
    echo "$filtered_line" >> /var/log/application_filtered.log
done
```

### 6.3 åŠ¨æ€è„±æ•


**ğŸ­ å¯é€†è„±æ•ç­–ç•¥**
```bash
#!/bin/bash
# åŠ¨æ€è„±æ•å·¥å…·

# ç”Ÿæˆå›ºå®šçš„æ›¿æ¢æ˜ å°„
declare -A phone_map
declare -A email_map

anonymize_phone() {
    local phone=$1
    if [[ -z "${phone_map[$phone]}" ]]; then
        phone_map[$phone]="138$(printf "%08d" $((RANDOM % 100000000)))"
    fi
    echo "${phone_map[$phone]}"
}

anonymize_email() {
    local email=$1
    if [[ -z "${email_map[$email]}" ]]; then
        local user_hash=$(echo "$email" | md5sum | cut -c1-8)
        email_map[$email]="user_${user_hash}@example.com"
    fi
    echo "${email_map[$email]}"
}

# å¤„ç†æ—¥å¿—è¡Œ
process_log_line() {
    local line=$1
    
    # æ›¿æ¢æ‰‹æœºå·
    line=$(echo "$line" | sed -E 's/1[3-9][0-9]{9}/anonymize_phone &/ge')
    
    # æ›¿æ¢é‚®ç®±
    line=$(echo "$line" | sed -E 's/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/anonymize_email &/ge')
    
    echo "$line"
}
```

---

## 7. ğŸ’¾ æ—¥å¿—å¤‡ä»½å®‰å…¨


### 7.1 å¤‡ä»½ç­–ç•¥è®¾è®¡


**ğŸ“Š 3-2-1å¤‡ä»½åŸåˆ™**
```
3ä»½å‰¯æœ¬ï¼šåŸå§‹æ•°æ® + 2ä»½å¤‡ä»½
2ç§ä»‹è´¨ï¼šæœ¬åœ°å­˜å‚¨ + è¿œç¨‹å­˜å‚¨
1ä»½ç¦»çº¿ï¼šä¸€ä»½å¤‡ä»½å®Œå…¨ç¦»çº¿ä¿å­˜

å…·ä½“å®æ–½ï¼š
â”œâ”€â”€ åŸå§‹æ—¥å¿—     â†’ ç”Ÿäº§æœåŠ¡å™¨ SSD
â”œâ”€â”€ å¤‡ä»½1       â†’ æœ¬åœ° NAS (æ¯æ—¥åŒæ­¥)
â”œâ”€â”€ å¤‡ä»½2       â†’ äº‘å­˜å‚¨ (æ¯å‘¨åŒæ­¥)
â””â”€â”€ å¤‡ä»½3       â†’ ç¦»çº¿ç£å¸¦ (æ¯æœˆå½’æ¡£)
```

### 7.2 è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬


**ğŸ”§ å®Œæ•´å¤‡ä»½è§£å†³æ–¹æ¡ˆ**
```bash
#!/bin/bash
# æ—¥å¿—å¤‡ä»½ç®¡ç†è„šæœ¬

BACKUP_CONFIG="/etc/log-backup.conf"
LOG_DIRS="/var/log"
LOCAL_BACKUP="/backup/logs"
REMOTE_BACKUP="backup@storage-server:/backup/logs"
ENCRYPTION_KEY="/etc/backup/gpg-key"

# é…ç½®æ–‡ä»¶ç¤ºä¾‹
cat > "$BACKUP_CONFIG" << EOF
# å¤‡ä»½ä¿ç•™ç­–ç•¥
DAILY_RETENTION=30     # ä¿ç•™30å¤©çš„æ—¥å¤‡ä»½
WEEKLY_RETENTION=12    # ä¿ç•™12å‘¨çš„å‘¨å¤‡ä»½  
MONTHLY_RETENTION=12   # ä¿ç•™12ä¸ªæœˆçš„æœˆå¤‡ä»½

# å‹ç¼©å’ŒåŠ å¯†è®¾ç½®
COMPRESSION_LEVEL=9
ENCRYPTION_ENABLED=true
VERIFY_BACKUP=true
EOF

source "$BACKUP_CONFIG"

create_backup() {
    local backup_type=$1  # daily/weekly/monthly
    local timestamp=$(date +%Y%m%d_%H%M%S)
    local backup_name="logs_${backup_type}_${timestamp}"
    
    echo "ğŸš€ å¼€å§‹ $backup_type å¤‡ä»½: $backup_name"
    
    # åˆ›å»ºå‹ç¼©åŒ…
    tar -czf "/tmp/${backup_name}.tar.gz" \
        --exclude="*.tmp" \
        --exclude="*.lock" \
        "$LOG_DIRS"
    
    # åŠ å¯†å¤‡ä»½æ–‡ä»¶
    if [ "$ENCRYPTION_ENABLED" = "true" ]; then
        gpg --quiet --symmetric \
            --cipher-algo AES256 \
            --output "/tmp/${backup_name}.tar.gz.gpg" \
            "/tmp/${backup_name}.tar.gz"
        rm "/tmp/${backup_name}.tar.gz"
        backup_file="/tmp/${backup_name}.tar.gz.gpg"
    else
        backup_file="/tmp/${backup_name}.tar.gz"
    fi
    
    # å¤åˆ¶åˆ°æœ¬åœ°å¤‡ä»½ä½ç½®
    cp "$backup_file" "$LOCAL_BACKUP/"
    
    # åŒæ­¥åˆ°è¿œç¨‹
    rsync -av --append-verify "$backup_file" "$REMOTE_BACKUP/"
    
    # éªŒè¯å¤‡ä»½å®Œæ•´æ€§
    if [ "$VERIFY_BACKUP" = "true" ]; then
        verify_backup "$backup_file"
    fi
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm "$backup_file"
    
    echo "âœ… å¤‡ä»½å®Œæˆ: $backup_name"
}

verify_backup() {
    local backup_file=$1
    echo "ğŸ” éªŒè¯å¤‡ä»½å®Œæ•´æ€§..."
    
    if [[ "$backup_file" =~ \.gpg$ ]]; then
        # éªŒè¯åŠ å¯†æ–‡ä»¶
        gpg --quiet --decrypt "$backup_file" | tar -tzf - > /dev/null
    else
        # éªŒè¯æ™®é€šå‹ç¼©æ–‡ä»¶
        tar -tzf "$backup_file" > /dev/null
    fi
    
    if [ $? -eq 0 ]; then
        echo "âœ… å¤‡ä»½éªŒè¯é€šè¿‡"
    else
        echo "âŒ å¤‡ä»½éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼"
        send_alert "å¤‡ä»½éªŒè¯å¤±è´¥: $backup_file"
    fi
}

cleanup_old_backups() {
    local backup_dir=$1
    local pattern=$2
    local retention_days=$3
    
    find "$backup_dir" -name "$pattern" -mtime +$retention_days -delete
    echo "ğŸ§¹ æ¸…ç†äº† $retention_days å¤©å‰çš„å¤‡ä»½æ–‡ä»¶"
}

# ä¸»æ‰§è¡Œé€»è¾‘
case "${1:-daily}" in
    daily)
        create_backup "daily"
        cleanup_old_backups "$LOCAL_BACKUP" "logs_daily_*" "$DAILY_RETENTION"
        ;;
    weekly)
        create_backup "weekly"
        cleanup_old_backups "$LOCAL_BACKUP" "logs_weekly_*" $((WEEKLY_RETENTION * 7))
        ;;
    monthly)
        create_backup "monthly"
        cleanup_old_backups "$LOCAL_BACKUP" "logs_monthly_*" $((MONTHLY_RETENTION * 30))
        ;;
    *)
        echo "ç”¨æ³•: $0 {daily|weekly|monthly}"
        exit 1
        ;;
esac
```

### 7.3 å¤‡ä»½æ¢å¤æµç¨‹


**ğŸ”„ æ¢å¤æ“ä½œæŒ‡å—**
```bash
#!/bin/bash
# æ—¥å¿—æ¢å¤è„šæœ¬

list_backups() {
    echo "ğŸ“‹ å¯ç”¨å¤‡ä»½åˆ—è¡¨:"
    ls -la /backup/logs/logs_*.tar.gz* | while read backup; do
        echo "  $(basename $backup) ($(date -r $backup '+%Y-%m-%d %H:%M'))"
    done
}

restore_backup() {
    local backup_file=$1
    local restore_target=${2:-/var/log/restored}
    
    echo "ğŸ”„ æ¢å¤å¤‡ä»½: $(basename $backup_file)"
    
    # åˆ›å»ºæ¢å¤ç›®å½•
    mkdir -p "$restore_target"
    
    # æ ¹æ®æ–‡ä»¶ç±»å‹è¿›è¡Œæ¢å¤
    if [[ "$backup_file" =~ \.gpg$ ]]; then
        # è§£å¯†å¹¶è§£å‹
        gpg --quiet --decrypt "$backup_file" | tar -xzf - -C "$restore_target"
    else
        # ç›´æ¥è§£å‹
        tar -xzf "$backup_file" -C "$restore_target"
    fi
    
    if [ $? -eq 0 ]; then
        echo "âœ… æ¢å¤å®Œæˆï¼Œæ–‡ä»¶ä½äº: $restore_target"
        echo "ğŸ“Š æ¢å¤ç»Ÿè®¡:"
        du -sh "$restore_target"
        find "$restore_target" -type f | wc -l | xargs echo "æ–‡ä»¶æ•°é‡:"
    else
        echo "âŒ æ¢å¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¤‡ä»½æ–‡ä»¶"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
case "${1:-list}" in
    list)
        list_backups
        ;;
    restore)
        if [ -z "$2" ]; then
            echo "è¯·æŒ‡å®šå¤‡ä»½æ–‡ä»¶è·¯å¾„"
            list_backups
        else
            restore_backup "$2" "$3"
        fi
        ;;
    *)
        echo "ç”¨æ³•: $0 {list|restore} [backup_file] [target_dir]"
        ;;
esac
```

---

## 8. âš–ï¸ æ³•è§„åˆè§„è¦æ±‚


### 8.1 å¸¸è§æ³•è§„è¦æ±‚


**ğŸ“œ ä¸»è¦æ³•è§„æ ‡å‡†**
```
å›½é™…æ ‡å‡†ï¼š
â”œâ”€â”€ SOXæ³•æ¡ˆ        â†’ è´¢åŠ¡æ•°æ®ä¿ç•™7å¹´ï¼Œå®Œæ•´æ€§ä¿æŠ¤
â”œâ”€â”€ GDPR          â†’ ä¸ªäººæ•°æ®ä¿æŠ¤ï¼Œå¯åˆ é™¤æƒï¼Œæ•°æ®æœ€å°åŒ–
â”œâ”€â”€ HIPAA         â†’ åŒ»ç–—æ•°æ®åŠ å¯†ï¼Œè®¿é—®å®¡è®¡ï¼Œä¿ç•™6å¹´
â””â”€â”€ PCI DSS       â†’ æ”¯ä»˜æ•°æ®ä¿æŠ¤ï¼Œå®æ—¶ç›‘æ§ï¼Œ1å¹´æ—¥å¿—ä¿ç•™

å›½å†…æ ‡å‡†ï¼š
â”œâ”€â”€ ç½‘ç»œå®‰å…¨æ³•    â†’ å…³é”®ä¿¡æ¯åŸºç¡€è®¾æ–½ä¿æŠ¤
â”œâ”€â”€ æ•°æ®å®‰å…¨æ³•    â†’ æ•°æ®åˆ†ç±»åˆ†çº§ä¿æŠ¤
â”œâ”€â”€ ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³• â†’ ä¸ªäººä¿¡æ¯å¤„ç†æ´»åŠ¨è®°å½•
â””â”€â”€ ç­‰ä¿2.0       â†’ å®‰å…¨å®¡è®¡ï¼Œæ—¥å¿—ä¿æŠ¤è¦æ±‚
```

### 8.2 åˆè§„é…ç½®æ¨¡æ¿


**ğŸ”§ SOXåˆè§„é…ç½®**
```bash
# SOXæ³•æ¡ˆåˆè§„çš„æ—¥å¿—é…ç½®
cat > /etc/rsyslog.d/sox-compliance.conf << 'EOF'
# SOXåˆè§„è¦æ±‚ï¼šæ‰€æœ‰è´¢åŠ¡ç›¸å…³æ“ä½œå¿…é¡»è®°å½•
# è´¢åŠ¡ç³»ç»Ÿå®¡è®¡æ—¥å¿—
if $programname startswith 'finance-app' then {
    /var/log/compliance/finance-audit.log
    stop
}

# æ•°æ®åº“æ“ä½œæ—¥å¿—
if $programname contains 'mysql' and $msg contains 'finance_db' then {
    /var/log/compliance/finance-db.log
    stop
}

# é…ç½®æ–‡ä»¶æ›´æ”¹æ—¥å¿—
if $msg contains 'configuration changed' then {
    /var/log/compliance/config-changes.log
    stop
}
EOF

# è®¾ç½®SOXåˆè§„çš„æ–‡ä»¶æƒé™
sudo chmod 600 /var/log/compliance/*.log
sudo chattr +a /var/log/compliance/*.log  # åªå…è®¸è¿½åŠ 
```

**ğŸ”’ GDPRåˆè§„é…ç½®**
```bash
# GDPRä¸ªäººæ•°æ®ä¿æŠ¤é…ç½®
cat > /etc/rsyslog.d/gdpr-compliance.conf << 'EOF'
# ä¸ªäººæ•°æ®å¤„ç†è®°å½•
template(name="GDPRFormat" type="string" 
    string="%timestamp% %hostname% %syslogtag% DATA_PROCESSING: %msg%\n")

# è®°å½•ä¸ªäººæ•°æ®è®¿é—®
if $msg contains 'personal_data_access' then {
    /var/log/compliance/gdpr-access.log;GDPRFormat
    stop
}

# è®°å½•æ•°æ®åˆ é™¤è¯·æ±‚
if $msg contains 'data_deletion_request' then {
    /var/log/compliance/gdpr-deletion.log;GDPRFormat
    stop
}

# è®°å½•æ•°æ®å¯¼å‡ºè¯·æ±‚
if $msg contains 'data_export_request' then {
    /var/log/compliance/gdpr-export.log;GDPRFormat
    stop
}
EOF
```

### 8.3 å®¡è®¡æŠ¥å‘Šç”Ÿæˆ


**ğŸ“Š è‡ªåŠ¨åŒ–åˆè§„æŠ¥å‘Š**
```bash
#!/bin/bash
# åˆè§„å®¡è®¡æŠ¥å‘Šç”Ÿæˆå™¨

REPORT_DIR="/var/reports/compliance"
COMPLIANCE_LOGS="/var/log/compliance"

generate_sox_report() {
    local month=$1
    local year=$2
    local report_file="$REPORT_DIR/sox_report_${year}_${month}.html"
    
    cat > "$report_file" << EOF
<!DOCTYPE html>
<html>
<head>
    <title>SOXåˆè§„æŠ¥å‘Š - $yearå¹´$monthæœˆ</title>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .compliant { color: green; }
        .non-compliant { color: red; }
    </style>
</head>
<body>
    <h1>SOXåˆè§„å®¡è®¡æŠ¥å‘Š</h1>
    <p>æŠ¥å‘Šå‘¨æœŸ: $yearå¹´$monthæœˆ</p>
    
    <h2>è´¢åŠ¡ç³»ç»Ÿè®¿é—®ç»Ÿè®¡</h2>
    <table>
        <tr><th>æ—¥æœŸ</th><th>ç”¨æˆ·</th><th>æ“ä½œ</th><th>çŠ¶æ€</th></tr>
EOF

    # åˆ†æè´¢åŠ¡å®¡è®¡æ—¥å¿—
    grep "$(date -d "$year-$month-01" +%Y-%m)" "$COMPLIANCE_LOGS/finance-audit.log" | \
    while read line; do
        # è§£ææ—¥å¿—è¡Œå¹¶ç”Ÿæˆè¡¨æ ¼è¡Œ
        echo "        <tr><td>$date</td><td>$user</td><td>$operation</td><td class='compliant'>åˆè§„</td></tr>" >> "$report_file"
    done
    
    cat >> "$report_file" << EOF
    </table>
    
    <h2>åˆè§„æ£€æŸ¥ç»“æœ</h2>
    <ul>
        <li class="compliant">âœ… æ‰€æœ‰è´¢åŠ¡æ“ä½œå·²è®°å½•</li>
        <li class="compliant">âœ… è®¿é—®æ§åˆ¶æ­£å¸¸</li>
        <li class="compliant">âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡</li>
    </ul>
    
    <p>æŠ¥å‘Šç”Ÿæˆæ—¶é—´: $(date)</p>
</body>
</html>
EOF

    echo "ğŸ“Š SOXåˆè§„æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}

generate_gdpr_report() {
    local report_file="$REPORT_DIR/gdpr_report_$(date +%Y%m%d).json"
    
    cat > "$report_file" << EOF
{
    "report_type": "GDPR_Compliance",
    "generation_date": "$(date -Iseconds)",
    "period": {
        "start": "$(date -d '1 month ago' +%Y-%m-%d)",
        "end": "$(date +%Y-%m-%d)"
    },
    "data_processing_activities": {
        "personal_data_access": $(grep -c "personal_data_access" "$COMPLIANCE_LOGS/gdpr-access.log"),
        "data_deletion_requests": $(grep -c "data_deletion_request" "$COMPLIANCE_LOGS/gdpr-deletion.log"),
        "data_export_requests": $(grep -c "data_export_request" "$COMPLIANCE_LOGS/gdpr-export.log")
    },
    "compliance_status": "COMPLIANT",
    "recommendations": [
        "ç»§ç»­ä¿æŒå½“å‰çš„æ•°æ®ä¿æŠ¤æªæ–½",
        "å®šæœŸå®¡æŸ¥ä¸ªäººæ•°æ®å¤„ç†æ´»åŠ¨",
        "ç¡®ä¿æ•°æ®ä¸»ä½“æƒåˆ©çš„åŠæ—¶å“åº”"
    ]
}
EOF

    echo "ğŸ“‹ GDPRåˆè§„æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}

# ç”Ÿæˆæœˆåº¦åˆè§„æŠ¥å‘Š
generate_monthly_reports() {
    local current_month=$(date +%m)
    local current_year=$(date +%Y)
    
    echo "ğŸ—ï¸ ç”Ÿæˆ $current_year å¹´ $current_month æœˆåˆè§„æŠ¥å‘Š..."
    
    generate_sox_report "$current_month" "$current_year"
    generate_gdpr_report
    
    echo "âœ… æ‰€æœ‰åˆè§„æŠ¥å‘Šç”Ÿæˆå®Œæˆ"
}

# æ‰§è¡ŒæŠ¥å‘Šç”Ÿæˆ
case "${1:-monthly}" in
    monthly)
        generate_monthly_reports
        ;;
    sox)
        generate_sox_report "${2:-$(date +%m)}" "${3:-$(date +%Y)}"
        ;;
    gdpr)
        generate_gdpr_report
        ;;
    *)
        echo "ç”¨æ³•: $0 {monthly|sox|gdpr} [month] [year]"
        ;;
esac
```

### 8.4 åˆè§„æ£€æŸ¥æ¸…å•


**âœ… æ—¥å¸¸åˆè§„æ£€æŸ¥**
```bash
#!/bin/bash
# åˆè§„æ£€æŸ¥è‡ªåŠ¨åŒ–è„šæœ¬

check_log_retention() {
    echo "ğŸ” æ£€æŸ¥æ—¥å¿—ä¿ç•™ç­–ç•¥..."
    
    # æ£€æŸ¥7å¹´ä¿ç•™æœŸï¼ˆSOXè¦æ±‚ï¼‰
    local seven_years_ago=$(date -d '7 years ago' +%Y%m%d)
    if find /var/log/compliance -name "*finance*" -newermt "$seven_years_ago" | grep -q .; then
        echo "âœ… è´¢åŠ¡æ—¥å¿—ä¿ç•™æœŸæ»¡è¶³SOXè¦æ±‚"
    else
        echo "âŒ è´¢åŠ¡æ—¥å¿—ä¿ç•™æœŸä¸è¶³7å¹´"
    fi
}

check_access_controls() {
    echo "ğŸ” æ£€æŸ¥è®¿é—®æ§åˆ¶..."
    
    # æ£€æŸ¥å…³é”®æ—¥å¿—æ–‡ä»¶æƒé™
    local critical_logs=(
        "/var/log/auth.log"
        "/var/log/audit/audit.log"
        "/var/log/compliance/finance-audit.log"
    )
    
    for log in "${critical_logs[@]}"; do
        if [ -f "$log" ]; then
            local perms=$(stat -c "%a" "$log")
            if [ "$perms" -le "640" ]; then
                echo "âœ… $log æƒé™è®¾ç½®åˆè§„ ($perms)"
            else
                echo "âŒ $log æƒé™è¿‡äºå®½æ¾ ($perms)"
            fi
        fi
    done
}

check_encryption() {
    echo "ğŸ” æ£€æŸ¥åŠ å¯†çŠ¶æ€..."
    
    # æ£€æŸ¥å½’æ¡£æ—¥å¿—æ˜¯å¦åŠ å¯†
    local encrypted_count=$(find /var/log/encrypted -name "*.gpg" | wc -l)
    local total_count=$(find /var/log -name "*.log.*" | wc -l)
    
    if [ "$encrypted_count" -gt 0 ]; then
        echo "âœ… å‘ç° $encrypted_count ä¸ªåŠ å¯†æ—¥å¿—æ–‡ä»¶"
    else
        echo "âš ï¸ æœªå‘ç°åŠ å¯†æ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å¯ç”¨åŠ å¯†"
    fi
}

generate_compliance_summary() {
    echo "ğŸ“‹ ç”Ÿæˆåˆè§„æ£€æŸ¥æ‘˜è¦..."
    
    cat > "/var/reports/compliance_check_$(date +%Y%m%d).txt" << EOF
åˆè§„æ£€æŸ¥æŠ¥å‘Š
============
æ£€æŸ¥æ—¶é—´: $(date)
æ£€æŸ¥äººå‘˜: $(whoami)

æ£€æŸ¥é¡¹ç›®ï¼š
- æ—¥å¿—ä¿ç•™ç­–ç•¥: $(check_log_retention | tail -1)
- è®¿é—®æ§åˆ¶: $(check_access_controls | grep -c "âœ…") é¡¹é€šè¿‡
- åŠ å¯†çŠ¶æ€: $(check_encryption | tail -1)

å»ºè®®ï¼š
1. å®šæœŸæ£€æŸ¥æ—¥å¿—å®Œæ•´æ€§
2. æ›´æ–°è®¿é—®æ§åˆ¶ç­–ç•¥
3. å¯ç”¨è‡ªåŠ¨åŒ–åŠ å¯†å½’æ¡£

ä¸‹æ¬¡æ£€æŸ¥æ—¶é—´: $(date -d '+1 month')
EOF
}

# æ‰§è¡Œå®Œæ•´çš„åˆè§„æ£€æŸ¥
main() {
    echo "ğŸš€ å¼€å§‹åˆè§„æ£€æŸ¥..."
    check_log_retention
    check_access_controls
    check_encryption
    generate_compliance_summary
    echo "âœ… åˆè§„æ£€æŸ¥å®Œæˆ"
}

main
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æƒé™è®¾ç½®ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œåˆ†å±‚æƒé™ç®¡ç†ï¼Œç”¨æˆ·ç»„æ§åˆ¶
ğŸ”¸ å®Œæ•´æ€§ä¿æŠ¤ï¼šå“ˆå¸Œæ ¡éªŒï¼Œæ•°å­—ç­¾åï¼Œå®æ—¶ç›‘æ§ï¼Œç‰ˆæœ¬æ§åˆ¶
ğŸ”¸ é˜²ç¯¡æ”¹æœºåˆ¶ï¼šåªè¿½åŠ æ¨¡å¼ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ï¼Œå®šæ—¶é”å®š
ğŸ”¸ åŠ å¯†å­˜å‚¨ï¼šæ–‡ä»¶çº§åŠ å¯†ï¼Œç£ç›˜çº§åŠ å¯†ï¼Œä¼ è¾“åŠ å¯†
ğŸ”¸ æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼šæ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤ï¼Œå®æ—¶è„±æ•ï¼Œå¯é€†åŒ¿ååŒ–
ğŸ”¸ å¤‡ä»½å®‰å…¨ï¼š3-2-1å¤‡ä»½ç­–ç•¥ï¼Œè‡ªåŠ¨åŒ–å¤‡ä»½ï¼Œå®Œæ•´æ€§éªŒè¯
ğŸ”¸ æ³•è§„åˆè§„ï¼šSOXã€GDPRã€ç­‰ä¿è¦æ±‚ï¼Œå®¡è®¡æŠ¥å‘Šï¼Œåˆè§„æ£€æŸ¥
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆæ—¥å¿—å®‰å…¨å¦‚æ­¤é‡è¦**
```
ä¸šåŠ¡ä»·å€¼ï¼š
- äº‹æ•…è°ƒæŸ¥çš„å…³é”®è¯æ®
- åˆè§„å®¡è®¡çš„å¿…è¦ææ–™  
- å®‰å…¨é˜²æŠ¤çš„é‡è¦æ•°æ®æº

é£é™©æ§åˆ¶ï¼š
- é˜²æ­¢æ”»å‡»è€…éšè—å…¥ä¾µç—•è¿¹
- é¿å…å†…éƒ¨äººå‘˜æ¶æ„ç¯¡æ”¹
- ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ä¸æ³„éœ²
```

**ğŸ”¹ å®‰å…¨é˜²æŠ¤çš„å±‚æ¬¡æ€è·¯**
```
ç‰©ç†å±‚é¢ï¼šç£ç›˜åŠ å¯†ï¼Œç¦»çº¿å­˜å‚¨
æ–‡ä»¶å±‚é¢ï¼šæƒé™æ§åˆ¶ï¼Œæ‰©å±•å±æ€§ä¿æŠ¤
å†…å®¹å±‚é¢ï¼šæ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼Œæ•°æ®è„±æ•
ä¼ è¾“å±‚é¢ï¼šåŠ å¯†ä¼ è¾“ï¼Œæ•°å­—ç­¾å
ç®¡ç†å±‚é¢ï¼šå¤‡ä»½ç­–ç•¥ï¼Œåˆè§„æ£€æŸ¥
```

**ğŸ”¹ å¹³è¡¡å®‰å…¨ä¸å¯ç”¨æ€§**
```
å®‰å…¨è¦æ±‚ vs æ“ä½œä¾¿åˆ©ï¼š
- è¿‡åº¦çš„æƒé™é™åˆ¶å½±å“æ—¥å¸¸è¿ç»´
- è¿‡åº¦åŠ å¯†å¢åŠ æ€§èƒ½å¼€é”€
- éœ€è¦åœ¨å®‰å…¨æ€§å’Œå®ç”¨æ€§é—´æ‰¾å¹³è¡¡

å®ç”¨å»ºè®®ï¼š
- æ ¹æ®æ—¥å¿—é‡è¦æ€§åˆ†çº§ä¿æŠ¤
- è‡ªåŠ¨åŒ–é™ä½å®‰å…¨æ“ä½œå¤æ‚åº¦
- å®šæœŸè¯„ä¼°å’Œè°ƒæ•´å®‰å…¨ç­–ç•¥
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ æ—¥å¿—å®‰å…¨å®æ–½è·¯å¾„**
```
ç¬¬1æ­¥ï¼šåŸºç¡€æƒé™é…ç½®
- è®¾ç½®åˆç†çš„æ–‡ä»¶å’Œç›®å½•æƒé™
- åˆ›å»ºä¸“ç”¨çš„æ—¥å¿—ç®¡ç†ç”¨æˆ·ç»„
- é…ç½®åŸºæœ¬çš„è®¿é—®æ§åˆ¶

ç¬¬2æ­¥ï¼šå®Œæ•´æ€§ä¿æŠ¤
- å¯ç”¨é‡è¦æ—¥å¿—çš„å“ˆå¸Œæ ¡éªŒ
- é…ç½®å®æ—¶æ–‡ä»¶ç›‘æ§å‘Šè­¦
- å®æ–½åªè¿½åŠ å†™å…¥ä¿æŠ¤

ç¬¬3æ­¥ï¼šåŠ å¯†å’Œå¤‡ä»½
- å¯¹å½’æ¡£æ—¥å¿—å¯ç”¨åŠ å¯†å­˜å‚¨
- å»ºç«‹è‡ªåŠ¨åŒ–å¤‡ä»½æœºåˆ¶
- éªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§

ç¬¬4æ­¥ï¼šåˆè§„ç®¡ç†
- æ ¹æ®è¡Œä¸šè¦æ±‚é…ç½®æ—¥å¿—ç­–ç•¥
- å»ºç«‹å®šæœŸçš„åˆè§„æ£€æŸ¥æµç¨‹
- ç”Ÿæˆå¿…è¦çš„å®¡è®¡æŠ¥å‘Š
```

**ğŸ”§ å¸¸ç”¨å·¥å…·å’Œå‘½ä»¤**
```bash
# åŸºç¡€æƒé™ç®¡ç†
chmod, chown, chgrp, umask

# æ‰©å±•å±æ€§ä¿æŠ¤  
chattr, lsattr

# è®¿é—®æ§åˆ¶åˆ—è¡¨
setfacl, getfacl

# æ–‡ä»¶ç›‘æ§
inotifywait, auditd

# åŠ å¯†å·¥å…·
gpg, cryptsetup

# å¤‡ä»½å·¥å…·
rsync, tar, rsnapshot

# æ—¥å¿—å¤„ç†
rsyslog, logrotate, sed, awk
```

**âš ï¸ å¸¸è§é™·é˜±å’Œè¯¯åŒº**
```
æƒé™è®¾ç½®è¿‡å®½ï¼š
âŒ 777æƒé™è®©æ‰€æœ‰äººéƒ½èƒ½ä¿®æ”¹æ—¥å¿—
âœ… 640æƒé™åªå…è®¸æ‰€æœ‰è€…å†™å…¥ï¼Œç»„ç”¨æˆ·è¯»å–

å¿½ç•¥æ—¥å¿—è½®è½¬å®‰å…¨ï¼š
âŒ è½®è½¬åçš„æ—§æ—¥å¿—æƒé™é”™è¯¯
âœ… é…ç½®copytruncateå’Œæ­£ç¡®çš„æƒé™ç»§æ‰¿

å¤‡ä»½ä¸åŠ å¯†ï¼š
âŒ å¤‡ä»½æ–‡ä»¶ä»¥æ˜æ–‡å­˜å‚¨
âœ… å¯¹å¤‡ä»½æ–‡ä»¶è¿›è¡ŒåŠ å¯†ä¿æŠ¤

ç¼ºä¹å®Œæ•´æ€§éªŒè¯ï¼š
âŒ åªåšå¤‡ä»½ä¸éªŒè¯
âœ… å®šæœŸæ ¡éªŒå¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
```

### 9.4 ç›‘æ§å’Œè¿ç»´


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```
æ–‡ä»¶æƒé™å˜æ›´ï¼š
- ç›‘æ§å…³é”®æ—¥å¿—æ–‡ä»¶æƒé™ä¿®æ”¹
- æ£€æµ‹å¼‚å¸¸çš„æƒé™è®¾ç½®

è®¿é—®æ¨¡å¼å¼‚å¸¸ï¼š
- ç›‘æ§éæ­£å¸¸æ—¶é—´çš„æ—¥å¿—è®¿é—®
- æ£€æµ‹å¤§é‡æ—¥å¿—æ–‡ä»¶è¯»å–

å®Œæ•´æ€§å‘Šè­¦ï¼š
- å“ˆå¸Œå€¼å˜æ›´å‘Šè­¦
- æ–‡ä»¶å¤§å°å¼‚å¸¸å‘Šè­¦

åˆè§„çŠ¶æ€ç›‘æ§ï¼š
- æ—¥å¿—ä¿ç•™æœŸæ£€æŸ¥
- åŠ å¯†çŠ¶æ€éªŒè¯
- å¤‡ä»½æˆåŠŸç‡ç»Ÿè®¡
```

**ğŸ¯ ä¼˜åŒ–å»ºè®®**
```
æ€§èƒ½ä¼˜åŒ–ï¼š
- åˆç†è®¾ç½®æ—¥å¿—è½®è½¬é¢‘ç‡
- ä½¿ç”¨SSDå­˜å‚¨æ´»è·ƒæ—¥å¿—
- å¼‚æ­¥å¤„ç†åŠ å¯†å’Œå¤‡ä»½ä»»åŠ¡

ç®¡ç†ä¼˜åŒ–ï¼š
- è‡ªåŠ¨åŒ–æ—¥å¿—å®‰å…¨é…ç½®
- å»ºç«‹æ ‡å‡†åŒ–çš„æƒé™æ¨¡æ¿
- å®æ–½å®šæœŸçš„å®‰å…¨æ£€æŸ¥

æˆæœ¬ä¼˜åŒ–ï¼š
- æ ¹æ®é‡è¦æ€§åˆ†çº§å­˜å‚¨
- é‡‡ç”¨å‹ç¼©å‡å°‘å­˜å‚¨å¼€é”€
- åˆç†è®¾ç½®æ—¥å¿—ä¿ç•™æœŸ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ—¥å¿—å®‰å…¨ä¸‰è¦ç´ ï¼šä¿å¯†æ€§ã€å®Œæ•´æ€§ã€å¯ç”¨æ€§
- æƒé™æ§åˆ¶è¦éµå¾ªæœ€å°æƒé™åŸåˆ™
- é‡è¦æ—¥å¿—å¿…é¡»æœ‰å®Œæ•´æ€§ä¿æŠ¤æœºåˆ¶
- å¤‡ä»½å’ŒåŠ å¯†æ˜¯æ—¥å¿—å®‰å…¨çš„é‡è¦ä¿éšœ
- åˆè§„è¦æ±‚é©±åŠ¨æ—¥å¿—å®‰å…¨ç­–ç•¥åˆ¶å®š

**ğŸ¯ ä¸€å¥è¯æ€»ç»“**ï¼š
> æ—¥å¿—æ˜¯ç³»ç»Ÿçš„"é»‘åŒ£å­"ï¼Œä¿æŠ¤å¥½æ—¥å¿—å°±æ˜¯ä¿æŠ¤å¥½ç³»ç»Ÿå®‰å…¨çš„æœ€åä¸€é“é˜²çº¿ï¼Œæƒé™æ§åˆ¶ã€å®Œæ•´æ€§ä¿æŠ¤ã€åŠ å¯†å¤‡ä»½ã€åˆè§„ç®¡ç†ç¼ºä¸€ä¸å¯ã€‚