---
title: 3、rsyslog核心配置与规则
---
## 📚 目录

1. [rsyslog基础概念与架构](#1-rsyslog基础概念与架构)
2. [配置文件结构详解](#2-配置文件结构详解)
3. [选择器规则语法](#3-选择器规则语法)
4. [动作配置与目标定义](#4-动作配置与目标定义)
5. [模块加载与功能扩展](#5-模块加载与功能扩展)
6. [过滤器配置技巧](#6-过滤器配置技巧)
7. [日志分离策略](#7-日志分离策略)
8. [配置文件包含机制](#8-配置文件包含机制)
9. [配置语法验证](#9-配置语法验证)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🏗️ rsyslog基础概念与架构


### 1.1 什么是rsyslog


**定义**：rsyslog是一个高性能的日志处理系统，是传统syslog的增强版本

```
简单理解：
系统中发生的各种事件（启动、错误、用户操作等）需要记录下来
rsyslog就是负责收集、处理、存储这些日志信息的"管家"
```

**💡 核心作用**：
- **日志收集**：从各个程序和系统组件收集日志信息
- **日志分类**：根据来源和重要性对日志进行分类
- **日志存储**：将日志写入文件、数据库或远程服务器
- **日志转发**：可以将日志发送到其他服务器

### 1.2 rsyslog vs 传统syslog


```
传统syslog的局限：
❌ 功能简单，只能基本记录
❌ 性能较低，处理能力有限
❌ 配置选项少，灵活性不足

rsyslog的优势：
✅ 高性能，可处理大量日志
✅ 模块化设计，功能可扩展
✅ 强大的过滤和路由功能
✅ 支持多种输出格式和目标
```

### 1.3 rsyslog工作原理


```
日志产生流程：
应用程序 → rsyslog守护进程 → 根据规则处理 → 写入目标位置

┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  应用程序    │───→│   rsyslog   │───→│  日志文件    │
│            │    │   守护进程   │    │            │
│ 系统服务    │    │             │    │ 远程服务器  │
│            │    │   规则引擎   │    │            │
│ 内核消息    │    │             │    │ 数据库      │
└─────────────┘    └─────────────┘    └─────────────┘
```

---

## 2. 📁 配置文件结构详解


### 2.1 主配置文件 `/etc/rsyslog.conf`


**基本结构**：
```bash
# 配置文件主要分为三部分：
# 1. 全局指令（GLOBAL DIRECTIVES）
# 2. 模块加载（MODULES）  
# 3. 规则定义（RULES）
```

**💻 配置文件示例**：
```bash
################

### MODULES ####

################

# 加载输入模块
$ModLoad imuxsock # 本地系统日志支持
$ModLoad imklog   # 内核日志支持

########################

### GLOBAL DIRECTIVES ####

########################

# 工作目录
$WorkDirectory /var/lib/rsyslog

# 设置默认权限
$FileOwner root
$FileGroup adm
$FileCreateMode 0640
$DirCreateMode 0755

##############

### RULES ####

##############

# 规则格式：选择器    动作
kern.*                          /var/log/kern.log
mail.*                          /var/log/mail.log
```

### 2.2 配置文件的三大部分详解


**🔧 1. 全局指令部分**
```bash
# 这部分设置rsyslog的全局行为
$WorkDirectory /var/lib/rsyslog    # 工作目录
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat  # 默认格式
$IncludeConfig /etc/rsyslog.d/*.conf  # 包含其他配置文件
```

**📦 2. 模块加载部分**
```bash
# 加载各种功能模块
$ModLoad imuxsock    # Unix套接字输入
$ModLoad imklog      # 内核日志输入  
$ModLoad imfile      # 文件输入
$ModLoad ommail      # 邮件输出
```

**📝 3. 规则定义部分**
```bash
# 定义日志的处理规则
# 格式：选择器  动作
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
authpriv.*                                  /var/log/secure
```

### 2.3 配置语法基础


**注释语法**：
```bash
# 这是注释行
*.* /var/log/messages  # 行尾注释
```

**🎯 配置行格式**：
```
选择器    动作
facility.priority    target
```

---

## 3. 🎯 选择器规则语法


### 3.1 什么是选择器


**简单理解**：选择器就是"筛选条件"，决定哪些日志消息需要处理

```
选择器 = 设施(facility) + 级别(priority)
格式：facility.priority
```

### 3.2 设施（Facility）类型


**📋 常用设施类型**：

| 设施名称 | **含义** | **示例** |
|---------|---------|----------|
| `kern` | `内核消息` | `系统启动、硬件错误` |
| `mail` | `邮件系统` | `sendmail、postfix日志` |
| `daemon` | `系统守护进程` | `网络服务、后台服务` |
| `auth` | `认证相关` | `登录、sudo操作` |
| `syslog` | `rsyslog自身` | `日志系统内部消息` |
| `user` | `用户程序` | `用户应用程序日志` |
| `local0-7` | `自定义设施` | `用户自定义日志分类` |

### 3.3 优先级（Priority）类型


**📊 优先级从高到低**：

| 级别 | **数值** | **含义** | **使用场景** |
|------|---------|----------|-------------|
| `emerg` | `0` | `紧急情况，系统不可用` | `系统崩溃` |
| `alert` | `1` | `需要立即处理` | `硬件故障` |
| `crit` | `2` | `严重错误` | `软件严重错误` |
| `err` | `3` | `错误` | `程序执行错误` |
| `warning` | `4` | `警告` | `潜在问题` |
| `notice` | `5` | `正常但重要` | `重要操作记录` |
| `info` | `6` | `信息性消息` | `常规信息` |
| `debug` | `7` | `调试信息` | `开发调试` |

### 3.4 选择器规则示例


**🔸 基本规则**：
```bash
# 内核所有级别的消息
kern.*                    /var/log/kern.log

# 邮件系统info级别及以上
mail.info                 /var/log/mail.log

# 认证相关所有消息  
auth.*                    /var/log/auth.log
```

**🔸 复合选择器**：
```bash
# 多个设施使用同一规则（用分号分隔）
mail,news.info           /var/log/info.log

# 排除特定设施（使用none）
*.info;mail.none         /var/log/messages

# 指定范围（使用-连接）
kern.warning-err         /var/log/kern-warn.log
```

**🔸 高级选择器**：
```bash
# 所有设施的所有消息
*.*                      /var/log/all.log

# 除了mail之外的所有info级别消息
*.info;mail.none         /var/log/messages

# 只记录error级别的消息（不包括更低级别）
*.=err                   /var/log/error-only.log

# 记录warning及以上级别（!表示取反）
*.!info                  /var/log/important.log
```

---

## 4. 🎯 动作配置与目标定义


### 4.1 什么是动作


**简单理解**：动作就是"做什么"，即对匹配的日志消息执行什么操作

```
常见动作类型：
📁 写入文件    - 最常用，保存到本地文件
📤 发送邮件    - 重要错误时发送邮件通知
🌐 转发日志    - 发送到远程日志服务器
👤 发送给用户  - 在用户终端显示
🗑️ 丢弃日志    - 不处理，直接丢弃
```

### 4.2 文件输出动作


**🔸 基本文件输出**：
```bash
# 写入指定文件
kern.*                   /var/log/kern.log
mail.*                   /var/log/mail.log

# 异步写入（在文件名前加-号）
kern.*                   -/var/log/kern.log
```

**💡 异步 vs 同步写入**：
```
同步写入：
✅ 数据安全，立即写入磁盘
❌ 性能较低，可能影响系统

异步写入：  
✅ 性能更好，减少磁盘IO
❌ 系统崩溃可能丢失部分日志
```

**🔸 动态文件名**：
```bash
# 根据主机名动态创建文件
$template DynFile,"/var/log/%HOSTNAME%.log"
*.* ?DynFile

# 根据日期创建文件  
$template DailyFile,"/var/log/%$YEAR%-%$MONTH%-%$DAY%.log"
*.* ?DailyFile
```

### 4.3 网络转发动作


**🌐 发送到远程服务器**：
```bash
# UDP协议发送（默认514端口）
*.* @192.168.1.100

# TCP协议发送
*.* $$192.168.1.100

# 指定端口
*.* @192.168.1.100:1514
```

**📡 协议选择指南**：
```
UDP协议 (@)：
✅ 速度快，开销小
❌ 不保证送达，可能丢失

TCP协议 ($$)：
✅ 可靠传输，保证送达  
❌ 开销较大，建立连接
```

### 4.4 其他动作类型


**📧 邮件通知**：
```bash
# 发送邮件（需要加载ommail模块）
$ModLoad ommail
$ActionMailSMTPServer smtp.example.com
$ActionMailFrom rsyslog@example.com
$ActionMailTo admin@example.com

# 严重错误发送邮件
*.crit :ommail:
```

**👤 发送给用户**：
```bash
# 发送给特定用户
*.alert                  root

# 发送给所有已登录用户
*.emerg                  *
```

**🗑️ 丢弃动作**：
```bash
# 丢弃垃圾邮件日志
mail.info                ~

# 停止进一步处理
local0.*                 /var/log/local0.log
& ~
```

---

## 5. 🧩 模块加载与功能扩展


### 5.1 rsyslog模块系统


**简单理解**：模块就像"插件"，为rsyslog添加特定功能

```
模块分类：
📥 输入模块(Input)   - 从哪里收集日志
📤 输出模块(Output)  - 往哪里发送日志
🔀 过滤模块(Filter)  - 如何处理日志
📐 解析模块(Parser)  - 如何解析日志格式
```

### 5.2 常用输入模块


**📋 输入模块列表**：

| 模块名称 | **功能** | **用途** |
|---------|----------|----------|
| `imuxsock` | `Unix套接字` | `本地系统日志` |
| `imklog` | `内核日志` | `内核消息收集` |
| `imfile` | `文件监控` | `监控指定文件变化` |
| `imudp` | `UDP网络` | `接收远程UDP日志` |
| `imtcp` | `TCP网络` | `接收远程TCP日志` |
| `imjournal` | `systemd日志` | `systemd journal集成` |

**💻 输入模块配置示例**：
```bash
# 基本系统日志输入
$ModLoad imuxsock
$ModLoad imklog

# 网络日志接收
$ModLoad imudp
$UDPServerRun 514
$UDPServerAddress 0.0.0.0

# 文件监控
$ModLoad imfile
$InputFileName /var/log/apache2/access.log
$InputFileTag apache:
$InputFileStateFile stat-apache
$InputRunFileMonitor
```

### 5.3 常用输出模块


**📋 输出模块列表**：

| 模块名称 | **功能** | **配置示例** |
|---------|----------|-------------|
| `omfile` | `文件输出` | `*.* /var/log/messages` |
| `omfwd` | `网络转发` | `*.* $$remote-server` |
| `ommail` | `邮件发送` | `*.crit :ommail:` |
| `ommysql` | `MySQL数据库` | `*.* :ommysql:db,user,pass` |
| `omprog` | `程序执行` | `*.* ^/usr/bin/process-log` |

### 5.4 模块加载语法


**🔧 加载模块**：
```bash
# 旧语法（仍然支持）
$ModLoad imudp
$ModLoad omfile

# 新语法（推荐）
module(load="imudp")
module(load="omfile")
```

**⚙️ 模块参数配置**：
```bash
# 新语法配置参数
module(load="imudp" 
       address="0.0.0.0" 
       port="514")

module(load="imfile" 
       PollingInterval="10")
```

---

## 6. 🔍 过滤器配置技巧


### 6.1 什么是过滤器


**简单理解**：过滤器是更精细的筛选条件，可以根据日志内容、时间等进行过滤

```
基本选择器 vs 过滤器：
基本选择器：根据设施和级别筛选
过滤器：根据日志内容、主机名、时间等筛选
```

### 6.2 基于内容的过滤器


**🔸 字符串匹配**：
```bash
# 包含特定字符串的日志
:msg, contains, "error"          /var/log/error-msgs.log

# 以特定字符串开始
:msg, startswith, "FAILED"       /var/log/failed.log

# 正则表达式匹配
:msg, regex, "user [a-zA-Z]+ login"  /var/log/user-login.log
```

**🔸 程序名过滤**：
```bash
# 特定程序的日志
:programname, isequal, "sshd"    /var/log/ssh.log

# 多个程序
:programname, isequal, "apache2" /var/log/apache.log
:programname, isequal, "nginx"   /var/log/nginx.log
```

### 6.3 基于属性的过滤器


**📋 常用属性过滤器**：

| 属性 | **含义** | **示例** |
|------|----------|----------|
| `hostname` | `主机名` | `:hostname, isequal, "web01"` |
| `fromhost-ip` | `来源IP` | `:fromhost-ip, startswith, "192.168"` |
| `timegenerated` | `时间` | `:timegenerated, regex, "2024-01-.*"` |
| `facility-text` | `设施名称` | `:facility-text, isequal, "mail"` |
| `priority-text` | `级别名称` | `:priority-text, isequal, "error"` |

**💻 属性过滤示例**：
```bash
# 只记录本地主机的日志
:hostname, isequal, "localhost"  /var/log/local-only.log

# 排除特定IP的日志
:fromhost-ip, !isequal, "192.168.1.100"  /var/log/filtered.log

# 只记录工作时间的日志
$template WorkHours,"%timegenerated:8:9%"
:timegenerated, regex, "0[89]|1[0-7]"    /var/log/workhours.log
```

### 6.4 条件表达式过滤器


**🔗 逻辑运算符**：
```bash
# AND条件
if ($facility-text == 'mail' and $severity >= 4) then {
    /var/log/mail-important.log
}

# OR条件  
if ($programname == 'sshd' or $programname == 'sudo') then {
    /var/log/security.log
}

# 复杂条件
if ($facility-text == 'kern' and $msg contains 'error') then {
    /var/log/kernel-errors.log
    stop
}
```

---

## 7. 📊 日志分离策略


### 7.1 为什么要分离日志


**问题场景**：
```
所有日志混在一起的问题：
❌ 难以查找特定类型的日志
❌ 重要日志被大量普通日志掩盖
❌ 日志文件过大，影响性能
❌ 不便于分析和监控
```

**分离的好处**：
```
✅ 便于问题定位和分析
✅ 提高查询效率
✅ 便于设置不同的保留策略
✅ 便于监控和告警
```

### 7.2 按服务分离


**🔸 Web服务器日志分离**：
```bash
# Apache日志
:programname, isequal, "apache2"     /var/log/apache2/apache.log
& stop

# Nginx日志
:programname, isequal, "nginx"       /var/log/nginx/nginx.log  
& stop

# 通用Web访问日志
:msg, contains, "GET /"              /var/log/web-access.log
```

**🔸 数据库日志分离**：
```bash
# MySQL日志
:programname, startswith, "mysql"    /var/log/mysql/mysql.log
& stop

# PostgreSQL日志
:programname, startswith, "postgres" /var/log/postgresql/postgres.log
& stop
```

### 7.3 按重要性分离


**🚨 按日志级别分离**：
```bash
# 紧急和严重错误
*.emerg;*.alert;*.crit               /var/log/critical.log

# 错误日志
*.err                                /var/log/error.log

# 警告日志
*.warning                            /var/log/warning.log

# 信息日志
*.info;*.notice                      /var/log/info.log

# 调试日志  
*.debug                              /var/log/debug.log
```

### 7.4 按功能分离


**🔐 安全相关日志**：
```bash
# 认证日志
auth,authpriv.*                      /var/log/auth.log

# SSH登录
:programname, isequal, "sshd"        /var/log/ssh.log

# sudo操作
:programname, isequal, "sudo"        /var/log/sudo.log

# 防火墙日志
:msg, contains, "iptables"           /var/log/firewall.log
```

**📧 邮件系统日志**：
```bash
# 所有邮件日志
mail.*                               /var/log/mail.log

# 邮件发送日志
mail.info                            /var/log/mail-info.log

# 邮件错误日志
mail.err                             /var/log/mail-error.log
```

### 7.5 动态文件名分离


**📅 按时间分离**：
```bash
# 模板定义
$template DailyFile,"/var/log/%$YEAR%/%$MONTH%/%$DAY%/messages.log"
$template HourlyFile,"/var/log/%$YEAR%-%$MONTH%-%$DAY%-%$HOUR%.log"

# 使用模板
*.*                                  ?DailyFile
kern.*                               ?HourlyFile
```

**🏠 按主机分离**：
```bash
# 远程主机日志分离
$template RemoteHost,"/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log"
:fromhost-ip, !isequal, "127.0.0.1" ?RemoteHost
```

---

## 8. 📦 配置文件包含机制


### 8.1 为什么使用包含机制


**问题**：
```
单个配置文件的问题：
❌ 配置文件过长，难以维护
❌ 不同服务的配置混在一起
❌ 修改配置容易出错
❌ 不便于模块化管理
```

**解决方案**：
```
✅ 将配置分散到多个文件
✅ 按功能或服务分类配置
✅ 便于维护和管理
✅ 支持模块化配置
```

### 8.2 包含语法


**🔧 基本包含语法**：
```bash
# 包含单个文件
$IncludeConfig /etc/rsyslog.d/50-default.conf

# 包含目录下所有.conf文件
$IncludeConfig /etc/rsyslog.d/*.conf

# 新语法（推荐）
include(file="/etc/rsyslog.d/*.conf")
```

### 8.3 标准目录结构


**📁 典型的配置目录结构**：
```
/etc/rsyslog.conf                 # 主配置文件
/etc/rsyslog.d/                   # 附加配置目录
├── 10-kernel.conf                # 内核日志配置
├── 20-auth.conf                  # 认证日志配置  
├── 30-mail.conf                  # 邮件日志配置
├── 40-apache.conf                # Apache配置
├── 50-default.conf               # 默认规则
└── 99-remote.conf                # 远程日志配置
```

**🔢 文件命名规范**：
```
命名格式：优先级-功能.conf
优先级：数字越小，越先加载
功能：描述配置的用途

示例：
10-kernel.conf     # 优先级10，内核配置
20-network.conf    # 优先级20，网络配置
50-default.conf    # 优先级50，默认配置
```

### 8.4 模块化配置示例


**🔸 主配置文件 `/etc/rsyslog.conf`**：
```bash
################

### MODULES ####

################

$ModLoad imuxsock
$ModLoad imklog

########################  

### GLOBAL DIRECTIVES ####

########################

$WorkDirectory /var/lib/rsyslog
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat

# 包含其他配置文件
$IncludeConfig /etc/rsyslog.d/*.conf
```

**🔸 邮件配置 `/etc/rsyslog.d/30-mail.conf`**：
```bash
# 邮件系统日志配置
mail.*                               /var/log/mail.log
mail.info                            /var/log/mail-info.log  
mail.warning                         /var/log/mail-warn.log
mail.err                             /var/log/mail-err.log

# 停止进一步处理邮件日志
& stop
```

**🔸 安全配置 `/etc/rsyslog.d/20-auth.conf`**：
```bash
# 认证和授权日志
auth,authpriv.*                      /var/log/auth.log

# SSH日志
:programname, isequal, "sshd"        /var/log/ssh.log

# sudo日志  
:programname, isequal, "sudo"        /var/log/sudo.log

# 停止进一步处理认证日志
& stop
```

---

## 9. ✅ 配置语法验证


### 9.1 为什么要验证配置


**配置错误的后果**：
```
❌ rsyslog服务无法启动
❌ 日志丢失或写入错误位置
❌ 系统日志功能失效
❌ 难以排查问题原因
```

### 9.2 语法检查命令


**🔍 基本语法检查**：
```bash
# 检查配置文件语法
rsyslogd -N1 -f /etc/rsyslog.conf

# 检查特定配置文件
rsyslogd -N1 -f /etc/rsyslog.d/30-mail.conf

# 详细语法检查
rsyslogd -N1 -f /etc/rsyslog.conf -d
```

**📊 检查结果解读**：
```bash
# 语法正确的输出
rsyslogd: version 8.24.0, config validation run (level 1), master config /etc/rsyslog.conf
rsyslogd: End of config validation run. Bye.

# 语法错误的输出  
rsyslogd: error during config validation: invalid directive 'xxx'
rsyslogd: CONFIG ERROR: could not interpret master config file '/etc/rsyslog.conf'.
```

### 9.3 常见配置错误


**🚨 语法错误示例**：

| 错误类型 | **错误写法** | **正确写法** |
|---------|-------------|-------------|
| `选择器语法` | `kern*` | `kern.*` |
| `动作缺失` | `mail.*` | `mail.* /var/log/mail.log` |
| `模块名错误` | `$ModLoad imudp` | `$ModLoad imudp` |
| `路径错误` | `*.* /log/messages` | `*.* /var/log/messages` |

**🔧 常见错误修复**：
```bash
# 错误：缺少点号
kern*                /var/log/kern.log
# 正确：
kern.*               /var/log/kern.log

# 错误：路径不存在
mail.*               /nonexistent/mail.log  
# 正确：确保目录存在
mail.*               /var/log/mail.log

# 错误：模块未加载
*.* $$remote-server
# 正确：先加载网络模块
$ModLoad omfwd
*.* $$remote-server
```

### 9.4 配置测试流程


**📋 标准测试步骤**：

```bash
# 1️⃣ 语法检查
sudo rsyslogd -N1 -f /etc/rsyslog.conf

# 2️⃣ 备份原配置
sudo cp /etc/rsyslog.conf /etc/rsyslog.conf.bak

# 3️⃣ 重启服务测试
sudo systemctl restart rsyslog
sudo systemctl status rsyslog

# 4️⃣ 查看错误日志
sudo journalctl -u rsyslog -n 20

# 5️⃣ 功能测试
logger "Test message"
tail /var/log/messages
```

**⚠️ 安全测试原则**：
```
✅ 总是备份原配置文件
✅ 在测试环境先验证
✅ 逐步应用配置更改
✅ 监控服务状态和日志
```

### 9.5 调试技巧


**🔍 启用调试模式**：
```bash
# 前台运行rsyslog进行调试
sudo rsyslogd -n -d

# 指定调试级别
sudo rsyslogd -n -d -v
```

**📝 日志级别调试**：
```bash
# 临时提高日志级别
echo "*.debug /tmp/debug.log" >> /etc/rsyslog.conf
sudo systemctl restart rsyslog

# 发送测试消息
logger -p kern.debug "Debug test message"
logger -p mail.info "Mail test message"

# 检查调试日志
tail -f /tmp/debug.log
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心概念


```
🔸 rsyslog架构：高性能模块化日志系统，替代传统syslog
🔸 配置文件结构：模块加载 + 全局指令 + 规则定义三部分
🔸 选择器语法：设施.级别的组合，决定处理哪些日志
🔸 动作类型：文件输出、网络转发、邮件通知等
🔸 模块系统：输入/输出/过滤/解析模块的组合使用
🔸 过滤器：基于内容、属性、条件的精细过滤
🔸 日志分离：按服务、级别、功能进行分类存储
🔸 包含机制：模块化配置文件管理
```

### 10.2 配置实践要点


**🔹 配置文件组织原则**：
```
层次化管理：
- 主配置文件定义全局设置
- 分离的配置文件处理特定功能
- 使用数字前缀控制加载顺序

模块化设计：
- 按功能分离配置文件
- 避免单个文件过于复杂
- 便于维护和故障排除
```

**🔹 选择器使用技巧**：
```
基本原则：
- 先特殊后一般：特定规则在前，通用规则在后
- 使用stop停止进一步处理
- 合理使用排除（none）和范围选择
- 善用复合选择器减少重复
```

**🔹 日志分离策略**：
```
分离维度：
- 按重要性：critical、error、warning、info
- 按服务：web、database、mail、auth
- 按来源：local、remote、specific-host
- 按时间：daily、hourly、monthly
```

### 10.3 常用配置模式


**🔸 标准服务器配置**：
```bash
# 系统核心日志
kern.*                    /var/log/kern.log
auth,authpriv.*           /var/log/auth.log
mail.*                    /var/log/mail.log

# 重要错误集中记录
*.emerg;*.alert;*.crit    /var/log/critical.log

# 排除已处理的日志，记录其他信息
*.info;mail.none;authpriv.none;cron.none  /var/log/messages
```

**🔸 远程日志服务器配置**：
```bash
# 接收远程日志
$ModLoad imudp
$UDPServerRun 514
$UDPServerAddress 0.0.0.0

# 按主机分离存储
$template RemoteHost,"/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log"
:fromhost-ip, !isequal, "127.0.0.1" ?RemoteHost
& stop
```

**🔸 高性能配置**：
```bash
# 异步IO提高性能
$MainMsgQueueType LinkedList
$MainMsgQueueSize 10000

# 异步文件写入
kern.*                    -/var/log/kern.log
mail.*                    -/var/log/mail.log
```

### 10.4 故障排除指南


**🔍 常见问题诊断**：
```
服务无法启动：
1. 检查配置语法：rsyslogd -N1 -f /etc/rsyslog.conf
2. 查看系统日志：journalctl -u rsyslog
3. 检查文件权限和路径

日志不生成：
1. 确认选择器规则正确
2. 检查目标目录存在且可写
3. 验证程序确实产生了日志

性能问题：
1. 启用异步写入
2. 调整队列大小
3. 使用适当的过滤规则
```

**✅ 最佳实践检查清单**：
- [ ] 配置文件语法检查通过
- [ ] 服务启动和运行正常
- [ ] 重要日志正确分离和存储
- [ ] 配置文件有备份和版本控制
- [ ] 日志轮转策略已配置
- [ ] 监控和告警机制已建立

**核心记忆要点**：
- rsyslog配置 = 模块 + 指令 + 规则
- 选择器筛选 + 动作处理 = 完整规则
- 先特殊后一般，合理使用stop
- 模块化配置便于维护管理
- 语法验证和测试必不可少