---
title: 10ã€logrotateé…ç½®ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [logrotateåŸºç¡€æ¦‚å¿µ](#1-logrotateåŸºç¡€æ¦‚å¿µ)
2. [è½®è½¬é¢‘ç‡é…ç½®è¯¦è§£](#2-è½®è½¬é¢‘ç‡é…ç½®è¯¦è§£)
3. [æ–‡ä»¶å¤§å°ä¸æ•°é‡æ§åˆ¶](#3-æ–‡ä»¶å¤§å°ä¸æ•°é‡æ§åˆ¶)
4. [å‹ç¼©ç­–ç•¥é…ç½®](#4-å‹ç¼©ç­–ç•¥é…ç½®)
5. [é«˜çº§é…ç½®é€‰é¡¹](#5-é«˜çº§é…ç½®é€‰é¡¹)
6. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#6-å®æˆ˜é…ç½®æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ logrotateåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯logrotate


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
logrotateï¼šLinuxç³»ç»Ÿè‡ªå¸¦çš„æ—¥å¿—è½®è½¬å·¥å…·
ä½œç”¨ï¼šè‡ªåŠ¨ç®¡ç†æ—¥å¿—æ–‡ä»¶ï¼Œé˜²æ­¢æ—¥å¿—æ–‡ä»¶æ— é™å¢é•¿å æ»¡ç£ç›˜
åŸç†ï¼šæŒ‰æ—¶é—´æˆ–å¤§å°å®šæœŸåˆ‡åˆ†ã€å‹ç¼©ã€åˆ é™¤æ—§æ—¥å¿—æ–‡ä»¶
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—è½®è½¬**
```
é—®é¢˜åœºæ™¯ï¼š
WebæœåŠ¡å™¨æ¯å¤©äº§ç”Ÿå‡ GBæ—¥å¿— â†’ ä¸€å¹´åç£ç›˜çˆ†æ»¡
æ•°æ®åº“æ—¥å¿—æŒç»­å¢é•¿ â†’ å½±å“ç³»ç»Ÿæ€§èƒ½
åº”ç”¨ç¨‹åºå´©æºƒæ—¥å¿—å †ç§¯ â†’ éš¾ä»¥æŸ¥æ‰¾æœ‰æ•ˆä¿¡æ¯

è§£å†³æ–¹æ¡ˆï¼š
âœ… å®šæœŸåˆ‡åˆ†ï¼šæŒ‰æ—¶é—´æˆ–å¤§å°åˆ†å‰²æ—¥å¿—æ–‡ä»¶
âœ… è‡ªåŠ¨å‹ç¼©ï¼šå‡å°‘å­˜å‚¨ç©ºé—´å ç”¨
âœ… æ¸…ç†æ—§æ–‡ä»¶ï¼šä¿ç•™å¿…è¦çš„å†å²è®°å½•
âœ… ä¿æŒæœåŠ¡ï¼šè½®è½¬è¿‡ç¨‹ä¸å½±å“æ­£åœ¨è¿è¡Œçš„ç¨‹åº
```

### 1.2 å·¥ä½œåŸç†å›¾ç¤º


```
åŸå§‹æ—¥å¿—æ–‡ä»¶çŠ¶æ€ï¼š
/var/log/apache2/access.log (2GB)

æ‰§è¡Œlogrotateåï¼š
/var/log/apache2/access.log      â† æ–°çš„ç©ºæ–‡ä»¶ï¼Œç»§ç»­å†™å…¥
/var/log/apache2/access.log.1    â† æ˜¨å¤©çš„æ—¥å¿—
/var/log/apache2/access.log.2.gz â† å‰å¤©çš„æ—¥å¿—(å‹ç¼©)
/var/log/apache2/access.log.3.gz â† å¤§å‰å¤©çš„æ—¥å¿—(å‹ç¼©)
/var/log/apache2/access.log.4.gz â† åˆ é™¤è¾¹ç•Œï¼Œå†è€çš„ä¼šè¢«åˆ é™¤
```

### 1.3 é…ç½®æ–‡ä»¶ç»“æ„


**ğŸ“ ä¸»è¦é…ç½®ä½ç½®**
```bash
/etc/logrotate.conf          # å…¨å±€é…ç½®æ–‡ä»¶
/etc/logrotate.d/            # å„æœåŠ¡ä¸“ç”¨é…ç½®ç›®å½•
â”œâ”€â”€ apache2                  # ApacheæœåŠ¡æ—¥å¿—é…ç½®
â”œâ”€â”€ mysql                    # MySQLæ•°æ®åº“æ—¥å¿—é…ç½®
â”œâ”€â”€ nginx                    # NginxæœåŠ¡æ—¥å¿—é…ç½®
â””â”€â”€ syslog                   # ç³»ç»Ÿæ—¥å¿—é…ç½®
```

**ğŸ—ï¸ åŸºæœ¬é…ç½®è¯­æ³•**
```bash
# åŸºæœ¬æ ¼å¼
/path/to/logfile {
    frequency           # è½®è½¬é¢‘ç‡
    rotate count       # ä¿ç•™æ–‡ä»¶æ•°
    size threshold     # å¤§å°é˜ˆå€¼
    compress           # å‹ç¼©é€‰é¡¹
    other options...   # å…¶ä»–é…ç½®é¡¹
}
```

---

## 2. â° è½®è½¬é¢‘ç‡é…ç½®è¯¦è§£


### 2.1 æ—¶é—´é¢‘ç‡é€‰é¡¹


**ğŸ“… daily - æ¯æ—¥è½®è½¬**
```bash
/var/log/webapp/app.log {
    daily              # æ¯å¤©è½®è½¬ä¸€æ¬¡
    rotate 30          # ä¿ç•™30å¤©çš„æ—¥å¿—
    compress           # å‹ç¼©æ—§æ–‡ä»¶
    missingok          # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
}

# é€‚ç”¨åœºæ™¯ï¼š
âœ… é«˜é¢‘è®¿é—®çš„Webåº”ç”¨
âœ… é¢‘ç¹æ“ä½œçš„æ•°æ®åº“
âœ… å®æ—¶äº¤æ˜“ç³»ç»Ÿ
```

**ğŸ“… weekly - æ¯å‘¨è½®è½¬**
```bash
/var/log/backup/backup.log {
    weekly             # æ¯å‘¨è½®è½¬ä¸€æ¬¡
    rotate 12          # ä¿ç•™3ä¸ªæœˆçš„æ—¥å¿—
    compress
    delaycompress      # å»¶è¿Ÿå‹ç¼©
}

# é€‚ç”¨åœºæ™¯ï¼š
âœ… å®šæœŸå¤‡ä»½ä»»åŠ¡æ—¥å¿—
âœ… ä¸­ç­‰é¢‘ç‡çš„åº”ç”¨æ—¥å¿—
âœ… å¼€å‘æµ‹è¯•ç¯å¢ƒ
```

**ğŸ“… monthly - æ¯æœˆè½®è½¬**
```bash
/var/log/archive/archive.log {
    monthly            # æ¯æœˆè½®è½¬ä¸€æ¬¡
    rotate 24          # ä¿ç•™2å¹´çš„æ—¥å¿—
    compress
    dateext            # ä½¿ç”¨æ—¥æœŸåç¼€
}

# é€‚ç”¨åœºæ™¯ï¼š
âœ… é•¿æœŸå½’æ¡£æ—¥å¿—
âœ… å®¡è®¡æ—¥å¿—
âœ… ä½é¢‘è®¿é—®çš„ç³»ç»Ÿæ—¥å¿—
```

### 2.2 è½®è½¬æ—¶æœºæ§åˆ¶


**â° ç²¾ç¡®æ—¶é—´æ§åˆ¶**
```bash
# å…¨å±€é…ç½®ç¤ºä¾‹ (/etc/logrotate.conf)
daily
rotate 4
create
dateext
include /etc/logrotate.d

# ç³»ç»Ÿä¼šåœ¨æ¯å¤©å‡Œæ™¨è‡ªåŠ¨æ‰§è¡Œ
# å…·ä½“æ—¶é—´ç”±cronä»»åŠ¡å†³å®šï¼š/etc/cron.daily/logrotate
```

**ğŸ” æ£€æŸ¥è½®è½¬çŠ¶æ€**
```bash
# æŸ¥çœ‹ä¸Šæ¬¡è½®è½¬æ—¶é—´
cat /var/lib/logrotate/status

# æ‰‹åŠ¨æµ‹è¯•é…ç½®
sudo logrotate -d /etc/logrotate.conf  # è°ƒè¯•æ¨¡å¼
sudo logrotate -f /etc/logrotate.conf  # å¼ºåˆ¶æ‰§è¡Œ
```

---

## 3. ğŸ“ æ–‡ä»¶å¤§å°ä¸æ•°é‡æ§åˆ¶


### 3.1 å¤§å°é˜ˆå€¼é…ç½®


**ğŸ“Š sizeå‚æ•°è¯¦è§£**
```bash
# æŒ‰æ–‡ä»¶å¤§å°è½®è½¬
/var/log/application/app.log {
    size 100M          # è¾¾åˆ°100MBå°±è½®è½¬
    rotate 5           # ä¿ç•™5ä¸ªå†å²æ–‡ä»¶
    compress
    notifempty         # ç©ºæ–‡ä»¶ä¸è½®è½¬
}

# å¤§å°å•ä½è¯´æ˜ï¼š
100     # 100å­—èŠ‚
100k    # 100KB  
100M    # 100MB
100G    # 100GB (å¾ˆå°‘ç”¨åˆ°)
```

**âš–ï¸ å¤§å°é˜ˆå€¼é€‰æ‹©ç­–ç•¥**
```
é«˜é¢‘åº”ç”¨ï¼š10M-50M
â€¢ å¿«é€Ÿå¢é•¿çš„æ—¥å¿—
â€¢ ä¾¿äºé—®é¢˜æ’æŸ¥
â€¢ é¿å…å•æ–‡ä»¶è¿‡å¤§

ä¸­é¢‘åº”ç”¨ï¼š50M-200M  
â€¢ ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿ
â€¢ å¹³è¡¡å­˜å‚¨å’Œç®¡ç†
â€¢ æ ‡å‡†é…ç½®æ¨è

ä½é¢‘åº”ç”¨ï¼š200M-1G
â€¢ ç³»ç»Ÿçº§æ—¥å¿—
â€¢ é•¿æœŸè¿è¡ŒæœåŠ¡
â€¢ å‡å°‘è½®è½¬å¼€é”€
```

### 3.2 ä¿ç•™æ•°é‡æ§åˆ¶


**ğŸ”¢ rotateå‚æ•°ç­–ç•¥**
```bash
# ä¸åŒä¿ç•™ç­–ç•¥ç¤ºä¾‹

# çŸ­æœŸä¿ç•™ - å¼€å‘ç¯å¢ƒ
/var/log/debug/debug.log {
    daily
    rotate 7           # åªä¿ç•™1å‘¨
    size 50M
    compress
}

# ä¸­æœŸä¿ç•™ - ç”Ÿäº§ç¯å¢ƒ  
/var/log/access/access.log {
    daily  
    rotate 30          # ä¿ç•™1ä¸ªæœˆ
    size 100M
    compress
}

# é•¿æœŸä¿ç•™ - å®¡è®¡æ—¥å¿—
/var/log/audit/audit.log {
    weekly
    rotate 52          # ä¿ç•™1å¹´
    size 500M
    compress
}
```

**ğŸ’¾ å­˜å‚¨ç©ºé—´è®¡ç®—**
```
è®¡ç®—å…¬å¼ï¼š
æ€»å­˜å‚¨ â‰ˆ æ—¥å¿—å¤§å° Ã— ä¿ç•™æ•°é‡ Ã— å‹ç¼©ç‡

ç¤ºä¾‹è®¡ç®—ï¼š
æ¯æ—¥100MBæ—¥å¿—ï¼Œä¿ç•™30å¤©ï¼Œå‹ç¼©ç‡70%
å­˜å‚¨éœ€æ±‚ = 100MB Ã— 30 Ã— 0.3 = 900MB

ä¼˜åŒ–å»ºè®®ï¼š
ğŸ“Š ç›‘æ§ç£ç›˜ä½¿ç”¨æƒ…å†µ
ğŸ“Š æ ¹æ®é‡è¦ç¨‹åº¦è°ƒæ•´ä¿ç•™ç­–ç•¥  
ğŸ“Š ä½¿ç”¨å‹ç¼©å‡å°‘ç©ºé—´å ç”¨
```

---

## 4. ğŸ—œï¸ å‹ç¼©ç­–ç•¥é…ç½®


### 4.1 å‹ç¼©ç®—æ³•é€‰æ‹©


**ğŸ“¦ compress - é»˜è®¤gzipå‹ç¼©**
```bash
/var/log/web/access.log {
    daily
    rotate 30
    compress              # å¯ç”¨gzipå‹ç¼©
    compresscmd gzip      # æ˜ç¡®æŒ‡å®šå‹ç¼©å‘½ä»¤
    compressext .gz       # å‹ç¼©æ–‡ä»¶æ‰©å±•å
    compressoptions "-9"  # æœ€é«˜å‹ç¼©çº§åˆ«
}

# å‹ç¼©æ•ˆæœï¼š
åŸæ–‡ä»¶ï¼šaccess.log (100MB)
å‹ç¼©åï¼šaccess.log.1.gz (çº¦15-30MB)
å‹ç¼©ç‡ï¼š70-85%
```

**ğŸ”§ bzip2å‹ç¼©é…ç½®**
```bash
/var/log/database/mysql.log {
    weekly
    rotate 12
    compress
    compresscmd bzip2          # ä½¿ç”¨bzip2å‹ç¼©
    compressext .bz2           # bz2æ‰©å±•å  
    compressoptions "-9"       # æœ€é«˜å‹ç¼©çº§åˆ«
}

# å¯¹æ¯”åˆ†æï¼š
gzipï¼šå‹ç¼©é€Ÿåº¦å¿«ï¼Œå‹ç¼©ç‡ä¸­ç­‰
bzip2ï¼šå‹ç¼©é€Ÿåº¦æ…¢ï¼Œå‹ç¼©ç‡æ›´é«˜
é€‰æ‹©å»ºè®®ï¼šä¸€èˆ¬ç”¨gzipï¼Œå­˜å‚¨ç´§å¼ ç”¨bzip2
```

### 4.2 å»¶è¿Ÿå‹ç¼©é…ç½®


**â³ delaycompress - å»¶è¿Ÿå‹ç¼©**
```bash
/var/log/application/app.log {
    daily
    rotate 7
    compress
    delaycompress         # å»¶è¿Ÿä¸€ä¸ªå‘¨æœŸå‹ç¼©
    missingok
    notifempty
}

# å»¶è¿Ÿå‹ç¼©æ•ˆæœï¼š
app.log           â† å½“å‰æ—¥å¿—  
app.log.1         â† æ˜¨å¤©æ—¥å¿—(æœªå‹ç¼©)
app.log.2.gz      â† å‰å¤©æ—¥å¿—(å·²å‹ç¼©)
app.log.3.gz      â† å¤§å‰å¤©æ—¥å¿—(å·²å‹ç¼©)
```

**ğŸ’¡ å»¶è¿Ÿå‹ç¼©çš„å¥½å¤„**
```
å®é™…åº”ç”¨ä»·å€¼ï¼š
âœ… ç¨‹åºç»§ç»­å†™å…¥ï¼šæŸäº›ç¨‹åºå¯èƒ½è¿˜åœ¨å†™å…¥è½®è½¬åçš„æ–‡ä»¶
âœ… é—®é¢˜æ’æŸ¥ï¼šæœ€è¿‘çš„æ—¥å¿—æ–‡ä»¶ä¿æŒæœªå‹ç¼©ï¼Œä¾¿äºæŸ¥çœ‹
âœ… æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…è½®è½¬æ—¶çš„å‹ç¼©IOå¼€é”€
âœ… çµæ´»å¤„ç†ï¼šç»™ç¨‹åºä¸€ä¸ªç¼“å†²æœŸé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶
```

### 4.3 å‹ç¼©é…ç½®ä¼˜åŒ–


**âš¡ å‹ç¼©æ€§èƒ½ä¼˜åŒ–**
```bash
# é«˜æ€§èƒ½å‹ç¼©é…ç½®
/var/log/highfreq/*.log {
    daily
    rotate 15
    compress
    compressoptions "-1"      # å¿«é€Ÿå‹ç¼©æ¨¡å¼
    delaycompress
    sharedscripts            # å¤šæ–‡ä»¶å…±äº«è„šæœ¬
    postrotate
        /bin/kill -USR1 $(cat /var/run/nginx.pid)
    endscript
}

# é«˜å‹ç¼©ç‡é…ç½®  
/var/log/archive/*.log {
    monthly
    rotate 24
    compress
    compressoptions "-9"      # æœ€é«˜å‹ç¼©ç‡
    dateext
    dateformat -%Y%m%d
}
```

---

## 5. ğŸ› ï¸ é«˜çº§é…ç½®é€‰é¡¹


### 5.1 æ—¥æœŸåç¼€é…ç½®


**ğŸ“… dateext - æ—¥æœŸæ‰©å±•å**
```bash
/var/log/webapp/access.log {
    daily
    rotate 30
    dateext                    # å¯ç”¨æ—¥æœŸåç¼€
    dateformat -%Y%m%d        # è‡ªå®šä¹‰æ—¥æœŸæ ¼å¼
    compress
    delaycompress
}

# æ–‡ä»¶å‘½åæ•ˆæœï¼š
access.log                    # å½“å‰æ—¥å¿—
access.log-20250915          # 2025å¹´9æœˆ15æ—¥çš„æ—¥å¿—
access.log-20250914.gz       # 2025å¹´9æœˆ14æ—¥çš„æ—¥å¿—(å‹ç¼©)
access.log-20250913.gz       # 2025å¹´9æœˆ13æ—¥çš„æ—¥å¿—(å‹ç¼©)
```

**ğŸ·ï¸ å¸¸ç”¨æ—¥æœŸæ ¼å¼**
```bash
# ä¸åŒæ—¥æœŸæ ¼å¼ç¤ºä¾‹
dateformat -%Y%m%d           # access.log-20250915
dateformat -%Y-%m-%d         # access.log-2025-09-15  
dateformat -%Y%m%d-%H%M      # access.log-20250915-1430
dateformat .%Y%m%d           # access.log.20250915

# å‘¨è½®è½¬ç‰¹æ®Šæ ¼å¼
dateformat -%Y-W%U           # access.log-2025-W37 (ç¬¬37å‘¨)
```

### 5.2 æƒé™ä¿æŒé…ç½®


**ğŸ” create - åˆ›å»ºæ–°æ–‡ä»¶**
```bash
/var/log/secure/auth.log {
    daily
    rotate 30
    create 640 root adm       # æƒé™ æ‰€æœ‰è€… ç»„
    compress
    missingok
}

# æƒé™è¯´æ˜ï¼š
640ï¼šrw-r-----  (æ‰€æœ‰è€…è¯»å†™ï¼Œç»„åªè¯»ï¼Œå…¶ä»–æ— æƒé™)
644ï¼šrw-r--r--  (æ‰€æœ‰è€…è¯»å†™ï¼Œå…¶ä»–åªè¯»)  
600ï¼šrw-------  (ä»…æ‰€æœ‰è€…è¯»å†™)
```

**ğŸ‘¤ copytruncate - å¤åˆ¶æˆªæ–­**
```bash
/var/log/java/application.log {
    daily
    rotate 7
    copytruncate             # å¤åˆ¶åæ¸…ç©ºåŸæ–‡ä»¶
    compress
    notifempty
}

# é€‚ç”¨åœºæ™¯ï¼š
âœ… Javaåº”ç”¨æ— æ³•é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶
âœ… ç¨‹åºæŒç»­å†™å…¥åŒä¸€ä¸ªæ–‡ä»¶å¥æŸ„
âœ… æ— æ³•é€šè¿‡ä¿¡å·é€šçŸ¥ç¨‹åºé‡æ–°æ‰“å¼€æ—¥å¿—
```

### 5.3 ç©ºæ–‡ä»¶å¤„ç†ç­–ç•¥


**ğŸ“ ç©ºæ–‡ä»¶å¤„ç†é€‰é¡¹**
```bash
# æ ‡å‡†é…ç½®
/var/log/cron/cron.log {
    weekly
    rotate 4
    missingok             # æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¸æŠ¥é”™
    notifempty           # ç©ºæ–‡ä»¶ä¸è½®è½¬
    compress
    create 644 root root
}

# å¼ºåˆ¶è½®è½¬é…ç½®
/var/log/system/system.log {
    daily  
    rotate 7
    ifempty              # å³ä½¿ç©ºæ–‡ä»¶ä¹Ÿè½®è½¬
    compress
    create 644 root root
}
```

---

## 6. ğŸ’¼ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 6.1 WebæœåŠ¡å™¨æ—¥å¿—é…ç½®


**ğŸŒ Nginxè®¿é—®æ—¥å¿—**
```bash
# /etc/logrotate.d/nginx
/var/log/nginx/*.log {
    daily                    # æ¯å¤©è½®è½¬
    rotate 30               # ä¿ç•™30å¤©
    size 100M               # å¤§å°é˜ˆå€¼100MB
    compress               # å¯ç”¨å‹ç¼©
    delaycompress          # å»¶è¿Ÿå‹ç¼©
    missingok              # æ–‡ä»¶ç¼ºå¤±ä¸æŠ¥é”™
    notifempty            # ç©ºæ–‡ä»¶ä¸è½®è½¬
    create 644 www-data adm  # åˆ›å»ºæ–°æ–‡ä»¶æƒé™
    sharedscripts          # å…±äº«è„šæœ¬
    prerotate
        # è½®è½¬å‰æ‰§è¡Œ
        if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
            run-parts /etc/logrotate.d/httpd-prerotate; \
        fi \
    endscript
    postrotate
        # è½®è½¬åé‡æ–°åŠ è½½Nginx
        /bin/kill -USR1 `cat /run/nginx.pid 2>/dev/null` 2>/dev/null || true
    endscript
}
```

### 6.2 æ•°æ®åº“æ—¥å¿—é…ç½®


**ğŸ—„ï¸ MySQLæ—¥å¿—è½®è½¬**
```bash
# /etc/logrotate.d/mysql-server
/var/log/mysql/mysql.log /var/log/mysql/error.log {
    weekly                  # æ¯å‘¨è½®è½¬
    rotate 12              # ä¿ç•™3ä¸ªæœˆ
    size 500M              # å¤§æ–‡ä»¶é˜ˆå€¼
    compress
    delaycompress
    missingok
    notifempty
    create 640 mysql mysql  # MySQLç”¨æˆ·æƒé™
    postrotate
        # åˆ·æ–°MySQLæ—¥å¿—
        if test -x /usr/bin/mysqladmin && \
           /usr/bin/mysqladmin ping &>/dev/null
        then
            /usr/bin/mysqladmin flush-logs
        fi
    endscript
}
```

### 6.3 åº”ç”¨ç¨‹åºæ—¥å¿—é…ç½®


**â˜• Javaåº”ç”¨æ—¥å¿—**
```bash
# /etc/logrotate.d/java-app
/opt/app/logs/*.log {
    daily
    rotate 15              # ä¿ç•™2å‘¨
    size 200M
    compress
    compressoptions "-6"   # å¹³è¡¡å‹ç¼©ç‡å’Œé€Ÿåº¦
    dateext                # ä½¿ç”¨æ—¥æœŸåç¼€
    dateformat -%Y%m%d
    copytruncate          # Javaåº”ç”¨ç‰¹æ®Šå¤„ç†
    notifempty
    missingok
}

/opt/app/logs/gc.log {
    weekly                 # GCæ—¥å¿—å•ç‹¬é…ç½®
    rotate 8               # ä¿ç•™2ä¸ªæœˆ
    size 1G                # GCæ—¥å¿—å¯èƒ½å¾ˆå¤§
    compress
    copytruncate
    missingok
}
```

### 6.4 ç³»ç»Ÿæ—¥å¿—é…ç½®


**ğŸ–¥ï¸ ç³»ç»Ÿæ ¸å¿ƒæ—¥å¿—**
```bash
# /etc/logrotate.d/rsyslog
/var/log/syslog {
    daily
    rotate 7
    missingok
    notifempty
    compress
    delaycompress
    postrotate
        /usr/lib/rsyslog/rsyslog-rotate
    endscript
}

/var/log/auth.log {
    weekly                 # å®‰å…¨æ—¥å¿—ä¿ç•™æ›´ä¹…
    rotate 12
    compress
    delaycompress
    missingok
    notifempty
    create 640 root adm    # é™åˆ¶æƒé™
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„é…ç½®è¦ç‚¹


```
ğŸ”¸ è½®è½¬é¢‘ç‡ï¼šdaily/weekly/monthlyæ ¹æ®æ—¥å¿—é‡é€‰æ‹©
ğŸ”¸ æ–‡ä»¶å¤§å°ï¼šsizeå‚æ•°é˜²æ­¢å•æ–‡ä»¶è¿‡å¤§
ğŸ”¸ ä¿ç•™æ•°é‡ï¼šrotateå‚æ•°å¹³è¡¡å­˜å‚¨å’Œå†å²éœ€æ±‚
ğŸ”¸ å‹ç¼©ç­–ç•¥ï¼šcompress+delaycompressæ ‡å‡†ç»„åˆ
ğŸ”¸ æƒé™ç®¡ç†ï¼šcreateå‚æ•°ç¡®ä¿æ­£ç¡®çš„æ–‡ä»¶æƒé™
ğŸ”¸ ç©ºæ–‡ä»¶å¤„ç†ï¼šnotifemptyé¿å…æ— æ„ä¹‰è½®è½¬
```

### 7.2 é…ç½®é€‰æ‹©æŒ‡å¯¼åŸåˆ™


**ğŸ¯ è½®è½¬é¢‘ç‡é€‰æ‹©**
```
é«˜é¢‘åº”ç”¨ â†’ daily + sizeé˜ˆå€¼
ä¸­é¢‘åº”ç”¨ â†’ weekly + é€‚ä¸­ä¿ç•™æ•°
ä½é¢‘åº”ç”¨ â†’ monthly + é•¿æœŸä¿ç•™
```

**ğŸ’¾ å­˜å‚¨ä¼˜åŒ–ç­–ç•¥**
```
ç©ºé—´ç´§å¼  â†’ é«˜å‹ç¼©ç‡ + çŸ­ä¿ç•™æœŸ
æ€§èƒ½ä¼˜å…ˆ â†’ å¿«é€Ÿå‹ç¼© + delaycompress  
å®¡è®¡éœ€æ±‚ â†’ é•¿ä¿ç•™æœŸ + dateextå‘½å
```

**ğŸ”§ å®ç”¨é…ç½®æ¨¡æ¿**
```bash
# é€šç”¨Webåº”ç”¨æ¨¡æ¿
/var/log/app/*.log {
    daily
    rotate 30
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 644 app app
    copytruncate
}
```

### 7.3 å¸¸è§é—®é¢˜è§£å†³


**âš ï¸ è½®è½¬å¤±è´¥æ’æŸ¥**
```bash
# æ£€æŸ¥é…ç½®è¯­æ³•
sudo logrotate -d /etc/logrotate.conf

# æŸ¥çœ‹è½®è½¬çŠ¶æ€
cat /var/lib/logrotate/status

# æ‰‹åŠ¨å¼ºåˆ¶è½®è½¬
sudo logrotate -f /etc/logrotate.d/your-app

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
grep logrotate /var/log/syslog
```

**ğŸ” æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```
1. åˆç†è®¾ç½®å¤§å°é˜ˆå€¼ï¼Œé¿å…æ–‡ä»¶è¿‡å¤§æˆ–è¿‡å°
2. ä½¿ç”¨delaycompresså‡å°‘è½®è½¬æ—¶IOå‹åŠ›
3. sharedscriptså‡å°‘é‡å¤è„šæœ¬æ‰§è¡Œ
4. æ ¹æ®ç£ç›˜IOæƒ…å†µè°ƒæ•´å‹ç¼©çº§åˆ«
5. å®šæœŸç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
```

**ğŸ¯ æœ€ä½³å®è·µæ€»ç»“**
- **æµ‹è¯•å…ˆè¡Œ**ï¼šæ–°é…ç½®å…ˆç”¨-då‚æ•°æµ‹è¯•
- **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§æ—¥å¿—è½®è½¬çŠ¶æ€å’Œç£ç›˜ç©ºé—´
- **æƒé™æ§åˆ¶**ï¼šæ ¹æ®å®‰å…¨éœ€æ±‚è®¾ç½®åˆé€‚çš„æ–‡ä»¶æƒé™
- **å¤‡ä»½ç­–ç•¥**ï¼šé‡è¦æ—¥å¿—è€ƒè™‘é¢å¤–çš„å¤‡ä»½æœºåˆ¶
- **æ–‡æ¡£ç»´æŠ¤**ï¼šè®°å½•é…ç½®å˜æ›´å’Œå¯¹åº”çš„ä¸šåŠ¡åœºæ™¯

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é¢‘ç‡å¤§å°æ•°é‡å®šï¼Œå‹ç¼©å»¶è¿Ÿæƒé™æ¸…
- ç©ºæ–‡ä»¶å¤„ç†è¦è°¨æ…ï¼Œè„šæœ¬å‰åä¿è¿è¡Œ
- æµ‹è¯•ç›‘æ§ä¸å¯å°‘ï¼Œæ—¥å¿—ç®¡ç†ç³»ç»Ÿç¨³