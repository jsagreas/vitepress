---
title: 4ã€rsyslogé«˜çº§ç‰¹æ€§åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [rsyslogé«˜çº§ç‰¹æ€§æ¦‚è¿°](#1-rsyslogé«˜çº§ç‰¹æ€§æ¦‚è¿°)
2. [æ¨¡æ¿å®šä¹‰ä¸è‡ªå®šä¹‰æ ¼å¼](#2-æ¨¡æ¿å®šä¹‰ä¸è‡ªå®šä¹‰æ ¼å¼)
3. [é˜Ÿåˆ—é…ç½®ä¸æ€§èƒ½ä¼˜åŒ–](#3-é˜Ÿåˆ—é…ç½®ä¸æ€§èƒ½ä¼˜åŒ–)
4. [ç½‘ç»œä¼ è¾“é…ç½®](#4-ç½‘ç»œä¼ è¾“é…ç½®)
5. [TLSåŠ å¯†ä¼ è¾“è®¾ç½®](#5-TLSåŠ å¯†ä¼ è¾“è®¾ç½®)
6. [ç¼“å†²åŒºé…ç½®ä¸å†…å­˜ç®¡ç†](#6-ç¼“å†²åŒºé…ç½®ä¸å†…å­˜ç®¡ç†)
7. [å¤±è´¥é‡è¯•æœºåˆ¶](#7-å¤±è´¥é‡è¯•æœºåˆ¶)
8. [é€Ÿç‡é™åˆ¶é…ç½®](#8-é€Ÿç‡é™åˆ¶é…ç½®)
9. [è°ƒè¯•æ¨¡å¼ä¸æ•…éšœæ’æŸ¥](#9-è°ƒè¯•æ¨¡å¼ä¸æ•…éšœæ’æŸ¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” rsyslogé«˜çº§ç‰¹æ€§æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯rsyslogé«˜çº§ç‰¹æ€§


**rsyslogé«˜çº§ç‰¹æ€§**æŒ‡çš„æ˜¯è¶…è¶ŠåŸºç¡€æ—¥å¿—æ”¶é›†åŠŸèƒ½çš„å¼ºå¤§é…ç½®é€‰é¡¹ï¼Œè®©æ—¥å¿—ç³»ç»Ÿèƒ½å¤Ÿé€‚åº”å¤æ‚çš„ä¼ä¸šçº§ç¯å¢ƒéœ€æ±‚ã€‚

```
åŸºç¡€åŠŸèƒ½ vs é«˜çº§ç‰¹æ€§ï¼š

åŸºç¡€åŠŸèƒ½ï¼š
- æ”¶é›†ç³»ç»Ÿæ—¥å¿—
- å†™å…¥åˆ°æ–‡ä»¶
- ç®€å•çš„è¿‡æ»¤

é«˜çº§ç‰¹æ€§ï¼š
- è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼ˆæ¨¡æ¿ï¼‰
- ç½‘ç»œä¼ è¾“å’Œé›†ä¸­æ”¶é›†
- åŠ å¯†ä¼ è¾“ä¿è¯å®‰å…¨
- æ€§èƒ½ä¼˜åŒ–å’Œç¼“å†²ç®¡ç†
- æ•…éšœå¤„ç†å’Œé‡è¯•æœºåˆ¶
```

### 1.2 é«˜çº§ç‰¹æ€§çš„åº”ç”¨åœºæ™¯


**ğŸ¯ ä¼ä¸šçº§æ—¥å¿—ç®¡ç†**
- **å¤šæœåŠ¡å™¨ç¯å¢ƒ**ï¼šç»Ÿä¸€æ”¶é›†åˆ†æ•£åœ¨å„æœåŠ¡å™¨çš„æ—¥å¿—
- **å®‰å…¨è¦æ±‚**ï¼šæ—¥å¿—ä¼ è¾“éœ€è¦åŠ å¯†ä¿æŠ¤
- **é«˜å¹¶å‘åœºæ™¯**ï¼šå¤§é‡æ—¥å¿—éœ€è¦é«˜æ•ˆå¤„ç†
- **æ•…éšœæ¢å¤**ï¼šç½‘ç»œä¸­æ–­åèƒ½è‡ªåŠ¨æ¢å¤æ—¥å¿—ä¼ è¾“

### 1.3 rsyslogæ¶æ„ç†è§£


```
æ•°æ®æµæ¶æ„å›¾ï¼š

è¾“å…¥æº â†’ [ç¼“å†²åŒº] â†’ [å¤„ç†è§„åˆ™] â†’ [é˜Ÿåˆ—] â†’ è¾“å‡ºç›®æ ‡
  â†“           â†“          â†“         â†“         â†“
ç³»ç»Ÿæ—¥å¿—    å†…å­˜ç¼“å†²    è¿‡æ»¤æ ¼å¼åŒ–  å¼‚æ­¥é˜Ÿåˆ—   æ–‡ä»¶/ç½‘ç»œ
åº”ç”¨æ—¥å¿—    ç£ç›˜ç¼“å†²    æ¨¡æ¿åº”ç”¨    é‡è¯•æœºåˆ¶   æ•°æ®åº“
ç½‘ç»œæ—¥å¿—    å‹ç¼©å­˜å‚¨    é€Ÿç‡é™åˆ¶    æ•…éšœå¤„ç†   å…¶ä»–ç³»ç»Ÿ
```

---

## 2. ğŸ“ æ¨¡æ¿å®šä¹‰ä¸è‡ªå®šä¹‰æ ¼å¼


### 2.1 ä»€ä¹ˆæ˜¯rsyslogæ¨¡æ¿


**æ¨¡æ¿**å°±æ˜¯å®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼çš„"æ ·æ¿"ï¼Œå‘Šè¯‰rsyslogå¦‚ä½•ç»„ç»‡å’Œæ˜¾ç¤ºæ—¥å¿—ä¿¡æ¯ã€‚

> ğŸ’¡ **ç®€å•ç†è§£**  
> å°±åƒWordæ–‡æ¡£çš„æ¨¡æ¿ä¸€æ ·ï¼Œæ¨¡æ¿å®šä¹‰äº†æ—¥å¿—çš„"æ’ç‰ˆæ ¼å¼"

### 2.2 æ¨¡æ¿çš„åŸºæœ¬è¯­æ³•


**ğŸ”§ æ¨¡æ¿å®šä¹‰æ–¹å¼**

```bash
# æ–¹å¼1ï¼šä¼ ç»Ÿæ ¼å¼æ¨¡æ¿
$template æ¨¡æ¿åç§°,"æ ¼å¼å­—ç¬¦ä¸²"

# æ–¹å¼2ï¼šæ–°ç‰ˆRainerScriptæ ¼å¼
template(name="æ¨¡æ¿åç§°" type="string" string="æ ¼å¼å­—ç¬¦ä¸²")
```

### 2.3 å¸¸ç”¨æ¨¡æ¿å±æ€§è¯¦è§£


| å±æ€§å | å«ä¹‰ | ç¤ºä¾‹ |
|--------|------|------|
| `%timestamp%` | æ—¶é—´æˆ³ | `2025-09-15 10:30:00` |
| `%hostname%` | ä¸»æœºå | `web-server-01` |
| `%syslogtag%` | ç¨‹åºæ ‡è¯† | `nginx:` |
| `%msg%` | æ¶ˆæ¯å†…å®¹ | `404 Not Found` |
| `%pri%` | ä¼˜å…ˆçº§æ•°å­— | `134` |
| `%severity%` | ä¸¥é‡ç¨‹åº¦ | `info` |
| `%facility%` | è®¾æ–½ç±»å‹ | `local0` |

### 2.4 å®ç”¨æ¨¡æ¿ç¤ºä¾‹


**ğŸ“‹ JSONæ ¼å¼æ¨¡æ¿**
```bash
# åˆ›å»ºJSONæ ¼å¼çš„æ—¥å¿—æ¨¡æ¿
template(name="json-template" type="string"
  string="{\"timestamp\":\"%timestamp:::date-rfc3339%\",\"host\":\"%hostname%\",\"severity\":\"%syslogseverity-text%\",\"facility\":\"%syslogfacility-text%\",\"tag\":\"%syslogtag%\",\"message\":\"%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\"}\n")

# åº”ç”¨æ¨¡æ¿
*.* $$log-server:514;json-template
```

**ğŸ“‹ è‡ªå®šä¹‰æ ¼å¼æ¨¡æ¿**
```bash
# åˆ›å»ºä¾¿äºé˜…è¯»çš„æ ¼å¼
template(name="detailed-format" type="string"
  string="[%timestamp:::date-rfc3339%] [%hostname%] [%syslogseverity-text%] %syslogtag% %msg%\n")

# åº”ç”¨åˆ°æ‰€æœ‰æ—¥å¿—
*.* /var/log/detailed.log;detailed-format
```

**ğŸ“‹ CSVæ ¼å¼æ¨¡æ¿**
```bash
# CSVæ ¼å¼ä¾¿äºExcelåˆ†æ
template(name="csv-format" type="string"
  string="%timestamp:::date-rfc3339%,%hostname%,%syslogseverity-text%,%syslogfacility-text%,\"%msg%\"\n")

# å†™å…¥CSVæ–‡ä»¶
*.* /var/log/logs.csv;csv-format
```

### 2.5 æ¨¡æ¿å±æ€§ä¿®é¥°ç¬¦


**ğŸ”§ å¸¸ç”¨ä¿®é¥°ç¬¦è¯´æ˜**

| ä¿®é¥°ç¬¦ | ä½œç”¨ | ç¤ºä¾‹ |
|--------|------|------|
| `:::date-rfc3339` | æ ‡å‡†æ—¶é—´æ ¼å¼ | `2025-09-15T10:30:00+08:00` |
| `:::drop-last-lf` | å»é™¤æœ«å°¾æ¢è¡Œ | æ¸…ç†æ¶ˆæ¯æ ¼å¼ |
| `:::sp-if-no-1st-sp` | é¦–ä½æ— ç©ºæ ¼æ—¶æ·»åŠ  | æ ¼å¼åŒ–æ¶ˆæ¯ |
| `:::uppercase` | è½¬ä¸ºå¤§å†™ | `INFO` â†’ `INFO` |
| `:::lowercase` | è½¬ä¸ºå°å†™ | `INFO` â†’ `info` |

<details>
<summary>ğŸ”§ ç‚¹å‡»æŸ¥çœ‹é«˜çº§æ¨¡æ¿æŠ€å·§</summary>

```bash
# æ¡ä»¶æ ¼å¼åŒ–
template(name="conditional-format" type="string"
  string="%timestamp% %hostname% %$severity%: %if severity == 'error' then 'ERROR: ' else '' end%%msg%\n")

# å­—æ®µæˆªå–
template(name="truncated-format" type="string"
  string="%timestamp% %hostname:1:15% %msg:1:100%\n")  # ä¸»æœºåæœ€å¤š15å­—ç¬¦ï¼Œæ¶ˆæ¯æœ€å¤š100å­—ç¬¦
```
</details>

---

## 3. âš¡ é˜Ÿåˆ—é…ç½®ä¸æ€§èƒ½ä¼˜åŒ–


### 3.1 ä»€ä¹ˆæ˜¯rsyslogé˜Ÿåˆ—


**é˜Ÿåˆ—**æ˜¯rsyslogå†…éƒ¨çš„"ç¼“å†²åŒº"ï¼Œç”¨æ¥æš‚å­˜ç­‰å¾…å¤„ç†çš„æ—¥å¿—æ¶ˆæ¯ã€‚

```
é˜Ÿåˆ—å·¥ä½œåŸç†ï¼š

æ—¥å¿—äº§ç”Ÿ â†’ [è¾“å…¥] â†’ [ä¸»é˜Ÿåˆ—] â†’ [åŠ¨ä½œé˜Ÿåˆ—] â†’ [è¾“å‡º]
            â†“         â†“          â†“         â†“
          æ¥æ”¶æ¶ˆæ¯   æš‚å­˜å¤„ç†    ç­‰å¾…å‘é€   å†™å…¥ç›®æ ‡

é˜Ÿåˆ—çš„ä½œç”¨ï¼š
- ç¼“è§£å¤„ç†å‹åŠ›
- é˜²æ­¢æ—¥å¿—ä¸¢å¤±
- æé«˜ç³»ç»Ÿæ€§èƒ½
- å¤„ç†çªå‘æµé‡
```

### 3.2 é˜Ÿåˆ—ç±»å‹è¯¦è§£


**ğŸ”§ ä¸»è¦é˜Ÿåˆ—ç±»å‹**

| é˜Ÿåˆ—ç±»å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|------|----------|
| **å†…å­˜é˜Ÿåˆ—** | é€Ÿåº¦å¿«ï¼Œé‡å¯ä¸¢å¤± | é«˜æ€§èƒ½åœºæ™¯ |
| **ç£ç›˜é˜Ÿåˆ—** | å¯æŒä¹…åŒ–ï¼Œé€Ÿåº¦æ…¢ | é«˜å¯é æ€§è¦æ±‚ |
| **æ··åˆé˜Ÿåˆ—** | å†…å­˜+ç£ç›˜ç»“åˆ | **æ¨èé€‰æ‹©** |

### 3.3 é˜Ÿåˆ—æ€§èƒ½é…ç½®


**âš™ï¸ ä¸»é˜Ÿåˆ—é…ç½®**
```bash
# /etc/rsyslog.conf
# ä¸»é˜Ÿåˆ—é…ç½®
$MainMsgQueueType LinkedList          # é˜Ÿåˆ—ç±»å‹ï¼šé“¾è¡¨
$MainMsgQueueSize 100000              # é˜Ÿåˆ—å¤§å°ï¼š10ä¸‡æ¡æ¶ˆæ¯
$MainMsgQueueHighWaterMark 80000      # é«˜æ°´ä½ï¼š8ä¸‡æ¡å¼€å§‹ç£ç›˜å­˜å‚¨
$MainMsgQueueLowWaterMark 20000       # ä½æ°´ä½ï¼š2ä¸‡æ¡æ¢å¤å†…å­˜å­˜å‚¨
$MainMsgQueueMaxFileSize 100M         # ç£ç›˜æ–‡ä»¶æœ€å¤§100MB
$MainMsgQueueFileName mainqueue       # ç£ç›˜é˜Ÿåˆ—æ–‡ä»¶å
$MainMsgQueueSaveOnShutdown on        # å…³æœºæ—¶ä¿å­˜é˜Ÿåˆ—
```

**âš™ï¸ åŠ¨ä½œé˜Ÿåˆ—é…ç½®**
```bash
# ä¸ºç‰¹å®šåŠ¨ä½œé…ç½®é˜Ÿåˆ—
*.* $$remote-server:514
$ActionQueueType LinkedList
$ActionQueueSize 50000
$ActionQueueFileName remote_queue
$ActionQueueMaxFileSize 50M
$ActionQueueSaveOnShutdown on
```

### 3.4 å·¥ä½œçº¿ç¨‹é…ç½®


**ğŸ§µ çº¿ç¨‹ä¼˜åŒ–é…ç½®**
```bash
# å·¥ä½œçº¿ç¨‹æ•°é‡
$MainMsgQueueWorkerThreads 4          # ä¸»é˜Ÿåˆ—4ä¸ªå·¥ä½œçº¿ç¨‹
$MainMsgQueueWorkerThreadMinimumMessages 1000  # çº¿ç¨‹å¯åŠ¨é˜ˆå€¼

# åŠ¨ä½œçº¿ç¨‹é…ç½®  
$ActionQueueWorkerThreads 2            # åŠ¨ä½œé˜Ÿåˆ—2ä¸ªçº¿ç¨‹
$ActionResumeRetryCount -1             # æ— é™é‡è¯•
```

> âš ï¸ **çº¿ç¨‹é…ç½®æ³¨æ„**  
> çº¿ç¨‹æ•°é‡ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œé€šå¸¸è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°çš„1-2å€å³å¯

### 3.5 æ€§èƒ½ç›‘æ§é…ç½®


**ğŸ“Š é˜Ÿåˆ—çŠ¶æ€ç›‘æ§**
```bash
# å¯ç”¨ç»Ÿè®¡ä¿¡æ¯
$ModLoad impstats
$PStatInterval 60              # æ¯60ç§’è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
$PStatFile /var/log/rsyslog-stats.log

# ç»Ÿè®¡ä¿¡æ¯å†…å®¹åŒ…æ‹¬ï¼š
# - é˜Ÿåˆ—å¤§å°
# - å¤„ç†é€Ÿåº¦  
# - ä¸¢å¼ƒæ¶ˆæ¯æ•°
# - çº¿ç¨‹çŠ¶æ€
```

---

## 4. ğŸŒ ç½‘ç»œä¼ è¾“é…ç½®


### 4.1 ç½‘ç»œä¼ è¾“åŸºæœ¬æ¦‚å¿µ


**ç½‘ç»œä¼ è¾“**è®©rsyslogèƒ½å¤Ÿåœ¨ä¸åŒæœåŠ¡å™¨ä¹‹é—´å‘é€å’Œæ¥æ”¶æ—¥å¿—ï¼Œå®ç°é›†ä¸­åŒ–æ—¥å¿—ç®¡ç†ã€‚

```
ç½‘ç»œä¼ è¾“æ¶æ„ï¼š

å®¢æˆ·ç«¯æœåŠ¡å™¨                    æ—¥å¿—æœåŠ¡å™¨
     |                           |
   rsyslog ----ç½‘ç»œä¼ è¾“-----> rsyslog
     |                           |
  äº§ç”Ÿæ—¥å¿—                    å­˜å‚¨åˆ†æ

ä¼ è¾“åè®®é€‰æ‹©ï¼š
- UDPï¼šå¿«é€Ÿä½†ä¸å¯é 
- TCPï¼šå¯é ä½†ç›¸å¯¹è¾ƒæ…¢  
- RELPï¼šæœ€å¯é çš„ä¸“ç”¨åè®®
```

### 4.2 UDPä¼ è¾“é…ç½®


**ğŸ“¡ UDPå‘é€ç«¯é…ç½®**
```bash
# /etc/rsyslog.conf - å®¢æˆ·ç«¯
# æ‰€æœ‰æ—¥å¿—é€šè¿‡UDPå‘é€åˆ°æ—¥å¿—æœåŠ¡å™¨
*.* @log-server.example.com:514
# å•ä¸ª@è¡¨ç¤ºUDPä¼ è¾“

# ç‰¹å®šè®¾æ–½çš„æ—¥å¿—å‘é€
mail.* @log-server.example.com:514
auth.* @log-server.example.com:514
```

**ğŸ“¡ UDPæ¥æ”¶ç«¯é…ç½®**
```bash
# /etc/rsyslog.conf - æœåŠ¡ç«¯
# å¯ç”¨UDPæ¥æ”¶æ¨¡å—
$ModLoad imudp
$UDPServerRun 514              # ç›‘å¬514ç«¯å£
$UDPServerAddress 0.0.0.0      # ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£

# æ¥æ”¶åˆ°çš„æ—¥å¿—å­˜å‚¨è§„åˆ™
$template RemoteHost,"/var/log/remote/%hostname%/%$year%-%$month%-%$day%.log"
*.* ?RemoteHost
```

### 4.3 TCPä¼ è¾“é…ç½®


**ğŸ“¡ TCPå‘é€ç«¯é…ç½®**
```bash
# /etc/rsyslog.conf - å®¢æˆ·ç«¯  
# åŒ$$è¡¨ç¤ºTCPä¼ è¾“
*.* $$log-server.example.com:514

# å¸¦é˜Ÿåˆ—çš„TCPä¼ è¾“ï¼ˆæ¨èï¼‰
*.* $$log-server.example.com:514
$ActionQueueType LinkedList
$ActionQueueFileName tcp_queue
$ActionQueueSize 10000
$ActionResumeRetryCount -1     # æ— é™é‡è¯•
```

**ğŸ“¡ TCPæ¥æ”¶ç«¯é…ç½®**
```bash
# /etc/rsyslog.conf - æœåŠ¡ç«¯
# å¯ç”¨TCPæ¥æ”¶æ¨¡å—
$ModLoad imtcp
$InputTCPServerRun 514         # ç›‘å¬514ç«¯å£
$InputTCPMaxSessions 500       # æœ€å¤§500ä¸ªå¹¶å‘è¿æ¥

# æ¥æ”¶åˆ°çš„æ—¥å¿—å¤„ç†
$template RemoteLogs,"/var/log/remote/%hostname%/syslog.log"
*.* ?RemoteLogs
```

### 4.4 RELPå¯é ä¼ è¾“


**ğŸ”’ RELPå‘é€ç«¯é…ç½®**
```bash
# åŠ è½½RELPæ¨¡å—
$ModLoad omrelp

# RELPä¼ è¾“é…ç½®
*.* :omrelp:log-server.example.com:20514
$ActionQueueType LinkedList
$ActionQueueFileName relp_queue
$ActionQueueSize 50000
```

**ğŸ”’ RELPæ¥æ”¶ç«¯é…ç½®**
```bash
# åŠ è½½RELPæ¥æ”¶æ¨¡å—
$ModLoad imrelp
$InputRELPServerRun 20514      # ç›‘å¬20514ç«¯å£
$InputRELPServerBindRuleset RELP

# RELPä¸“ç”¨è§„åˆ™é›†
$RuleSet RELP
$template RELPLogs,"/var/log/relp/%hostname%/messages.log"
*.* ?RELPLogs
```

---

## 5. ğŸ” TLSåŠ å¯†ä¼ è¾“è®¾ç½®


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦TLSåŠ å¯†


**TLSåŠ å¯†**ä¿æŠ¤æ—¥å¿—åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨ï¼Œé˜²æ­¢è¢«çªƒå¬æˆ–ç¯¡æ”¹ã€‚

> ğŸ”’ **å®‰å…¨é‡è¦æ€§**  
> æ—¥å¿—å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆç”¨æˆ·ç™»å½•ã€ç³»ç»Ÿé”™è¯¯ï¼‰ï¼Œéœ€è¦åŠ å¯†ä¿æŠ¤

### 5.2 è¯ä¹¦å‡†å¤‡


**ğŸ“‹ ç”Ÿæˆè‡ªç­¾åè¯ä¹¦**
```bash
# åˆ›å»ºè¯ä¹¦ç›®å½•
mkdir -p /etc/rsyslog-certs
cd /etc/rsyslog-certs

# ç”ŸæˆCAç§é’¥
openssl genrsa -out ca-key.pem 2048

# ç”ŸæˆCAè¯ä¹¦
openssl req -new -x509 -key ca-key.pem -out ca-cert.pem -days 365 \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=MyOrg/CN=rsyslog-ca"

# ç”ŸæˆæœåŠ¡å™¨ç§é’¥
openssl genrsa -out server-key.pem 2048

# ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦è¯·æ±‚
openssl req -new -key server-key.pem -out server-req.pem \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=MyOrg/CN=log-server.example.com"

# ç­¾å‘æœåŠ¡å™¨è¯ä¹¦
openssl x509 -req -in server-req.pem -CA ca-cert.pem -CAkey ca-key.pem \
  -CAcreateserial -out server-cert.pem -days 365

# è®¾ç½®æƒé™
chmod 600 *-key.pem
chmod 644 *-cert.pem
```

### 5.3 TLSå‘é€ç«¯é…ç½®


**ğŸ” å®¢æˆ·ç«¯TLSé…ç½®**
```bash
# /etc/rsyslog.conf - å®¢æˆ·ç«¯
# åŠ è½½TLSæ¨¡å—
$DefaultNetstreamDriver gtls
$DefaultNetstreamDriverCAFile /etc/rsyslog-certs/ca-cert.pem
$DefaultNetstreamDriverCertFile /etc/rsyslog-certs/client-cert.pem
$DefaultNetstreamDriverKeyFile /etc/rsyslog-certs/client-key.pem

# TLSä¼ è¾“é…ç½®
$ActionSendStreamDriverAuthMode x509/name
$ActionSendStreamDriverPermittedPeer log-server.example.com
$ActionSendStreamDriverMode 1      # å¯ç”¨TLS

# å‘é€æ—¥å¿—
*.* $$log-server.example.com:6514
```

### 5.4 TLSæ¥æ”¶ç«¯é…ç½®


**ğŸ” æœåŠ¡ç«¯TLSé…ç½®**
```bash
# /etc/rsyslog.conf - æœåŠ¡ç«¯
# å…¨å±€TLSè®¾ç½®
$DefaultNetstreamDriver gtls
$DefaultNetstreamDriverCAFile /etc/rsyslog-certs/ca-cert.pem
$DefaultNetstreamDriverCertFile /etc/rsyslog-certs/server-cert.pem
$DefaultNetstreamDriverKeyFile /etc/rsyslog-certs/server-key.pem

# å¯ç”¨TCPè¾“å…¥æ¨¡å—
$ModLoad imtcp
$InputTCPServerStreamDriverAuthMode x509/name
$InputTCPServerStreamDriverPermittedPeer *.example.com
$InputTCPServerStreamDriverMode 1   # å¯ç”¨TLS
$InputTCPServerRun 6514            # TLSç«¯å£é€šå¸¸æ˜¯6514
```

### 5.5 TLSé…ç½®éªŒè¯


**ğŸ” éªŒè¯TLSè¿æ¥**
```bash
# æ£€æŸ¥TLSç«¯å£ç›‘å¬
netstat -tlnp | grep 6514

# æµ‹è¯•TLSè¿æ¥
openssl s_client -connect log-server.example.com:6514 \
  -CAfile /etc/rsyslog-certs/ca-cert.pem

# æŸ¥çœ‹rsyslogæ—¥å¿—
tail -f /var/log/rsyslog.log
```

---

## 6. ğŸ’¾ ç¼“å†²åŒºé…ç½®ä¸å†…å­˜ç®¡ç†


### 6.1 ç¼“å†²åŒºçš„ä½œç”¨


**ç¼“å†²åŒº**æ˜¯rsyslogç”¨æ¥ä¸´æ—¶å­˜å‚¨æ—¥å¿—çš„å†…å­˜æˆ–ç£ç›˜ç©ºé—´ï¼Œå¸®åŠ©åº”å¯¹çªå‘çš„å¤§é‡æ—¥å¿—ã€‚

```
ç¼“å†²åŒºå·¥ä½œæµç¨‹ï¼š

æ—¥å¿—äº§ç”Ÿ â†’ [è¾“å…¥ç¼“å†²] â†’ [å¤„ç†] â†’ [è¾“å‡ºç¼“å†²] â†’ ç›®æ ‡å­˜å‚¨
          å¿«é€Ÿæ¥æ”¶      æ ¼å¼åŒ–     æš‚å­˜ç­‰å¾…      æ–‡ä»¶/ç½‘ç»œ

ç¼“å†²åŒºçš„å¥½å¤„ï¼š
- æé«˜å¤„ç†æ•ˆç‡
- é¿å…æ—¥å¿—ä¸¢å¤±  
- å¹³æ»‘çªå‘æµé‡
- å‡å°‘ç£ç›˜I/O
```

### 6.2 å†…å­˜ç¼“å†²é…ç½®


**ğŸ§  å†…å­˜ç¼“å†²è®¾ç½®**
```bash
# /etc/rsyslog.conf
# ä¸»æ¶ˆæ¯é˜Ÿåˆ—å†…å­˜é…ç½®
$MainMsgQueueType LinkedList       # é“¾è¡¨é˜Ÿåˆ—ï¼ˆå†…å­˜ï¼‰
$MainMsgQueueSize 100000           # é˜Ÿåˆ—æœ€å¤§10ä¸‡æ¡æ¶ˆæ¯
$MainMsgQueueDiscardMark 95000     # 95%æ—¶å¼€å§‹ä¸¢å¼ƒä½ä¼˜å…ˆçº§æ¶ˆæ¯
$MainMsgQueueDiscardSeverity 4     # ä¸¢å¼ƒdebugçº§åˆ«ä»¥ä¸‹æ¶ˆæ¯

# å·¥ä½œçº¿ç¨‹é…ç½®
$MainMsgQueueWorkerThreads 4       # 4ä¸ªå·¥ä½œçº¿ç¨‹
$MainMsgQueueTimeoutShutdown 1000  # å…³æœºè¶…æ—¶1ç§’
```

### 6.3 ç£ç›˜ç¼“å†²é…ç½®


**ğŸ’¿ ç£ç›˜ç¼“å†²è®¾ç½®**
```bash
# ç£ç›˜é˜Ÿåˆ—é…ç½®
$MainMsgQueueType LinkedList
$MainMsgQueueFileName main_queue    # ç£ç›˜é˜Ÿåˆ—æ–‡ä»¶å‰ç¼€
$MainMsgQueueMaxFileSize 100M       # å•ä¸ªé˜Ÿåˆ—æ–‡ä»¶æœ€å¤§100MB
$MainMsgQueueMaxFiles 10            # æœ€å¤š10ä¸ªé˜Ÿåˆ—æ–‡ä»¶
$MainMsgQueueSaveOnShutdown on      # å…³æœºæ—¶ä¿å­˜é˜Ÿåˆ—åˆ°ç£ç›˜
$MainMsgQueueDequeueSlowdown 1000   # å¤„ç†å»¶è¿Ÿ1æ¯«ç§’
```

### 6.4 æ··åˆç¼“å†²ç­–ç•¥


**âš–ï¸ å†…å­˜+ç£ç›˜æ··åˆé…ç½®**
```bash
# æ™ºèƒ½æ··åˆç¼“å†²
$MainMsgQueueType LinkedList
$MainMsgQueueSize 50000             # å†…å­˜é˜Ÿåˆ—5ä¸‡æ¡
$MainMsgQueueHighWaterMark 40000    # 4ä¸‡æ¡æ—¶å¼€å§‹å†™ç£ç›˜
$MainMsgQueueLowWaterMark 10000     # 1ä¸‡æ¡æ—¶åœæ­¢å†™ç£ç›˜
$MainMsgQueueFileName mixed_queue   # ç£ç›˜é˜Ÿåˆ—æ–‡ä»¶
$MainMsgQueueMaxFileSize 50M        # ç£ç›˜æ–‡ä»¶å¤§å°
```

> ğŸ’¡ **æ··åˆç­–ç•¥ä¼˜åŠ¿**  
> å¹³æ—¶ä½¿ç”¨å†…å­˜ï¼ˆå¿«é€Ÿï¼‰ï¼Œç¹å¿™æ—¶ä½¿ç”¨ç£ç›˜ï¼ˆå¯é ï¼‰ï¼Œå…¼é¡¾æ€§èƒ½å’Œå¯é æ€§

### 6.5 å†…å­˜ç®¡ç†ä¼˜åŒ–


**ğŸ“Š å†…å­˜ä½¿ç”¨ç›‘æ§**
```bash
# ç›‘æ§rsyslogå†…å­˜ä½¿ç”¨
ps aux | grep rsyslog
top -p $(pgrep rsyslogd)

# æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€æ–‡ä»¶
ls -la /var/spool/rsyslog/

# ç³»ç»Ÿå†…å­˜ç›‘æ§
free -h
cat /proc/meminfo | grep -i available
```

**âš™ï¸ å†…å­˜ä¼˜åŒ–é…ç½®**
```bash
# é™åˆ¶å†…å­˜ä½¿ç”¨
$MaxMessageSize 8k                  # é™åˆ¶å•æ¡æ¶ˆæ¯8KB
$MainMsgQueueSize 10000             # å‡å°‘é˜Ÿåˆ—å¤§å°
$ActionQueueSize 5000               # å‡å°‘åŠ¨ä½œé˜Ÿåˆ—

# å¯ç”¨å‹ç¼©ï¼ˆèŠ‚çœå†…å­˜ï¼‰
$MainMsgQueueCompressionMode zip    # å¯ç”¨å‹ç¼©
$ActionQueueCompressionMode zip     # åŠ¨ä½œé˜Ÿåˆ—å‹ç¼©
```

---

## 7. ğŸ”„ å¤±è´¥é‡è¯•æœºåˆ¶


### 7.1 ä»€ä¹ˆæ˜¯å¤±è´¥é‡è¯•


**å¤±è´¥é‡è¯•**æ˜¯å½“æ—¥å¿—ä¼ è¾“å¤±è´¥æ—¶ï¼Œrsyslogè‡ªåŠ¨å°è¯•é‡æ–°å‘é€çš„æœºåˆ¶ã€‚

```
é‡è¯•æœºåˆ¶å·¥ä½œæµç¨‹ï¼š

æ—¥å¿—å‘é€ â†’ ç½‘ç»œæ•…éšœ â†’ å‘é€å¤±è´¥ â†’ æš‚å­˜é˜Ÿåˆ— â†’ å®šæ—¶é‡è¯• â†’ å‘é€æˆåŠŸ
   â†“          â†“          â†“          â†“          â†“          â†“
 æ­£å¸¸ä¼ è¾“   è¿æ¥æ–­å¼€    è¿”å›é”™è¯¯    æ”¾å…¥é˜Ÿåˆ—    ç­‰å¾…æ¢å¤    ç»§ç»­ä¼ è¾“

å¸¸è§å¤±è´¥åœºæ™¯ï¼š
- ç½‘ç»œè¿æ¥ä¸­æ–­
- ç›®æ ‡æœåŠ¡å™¨å®•æœº
- ç£ç›˜ç©ºé—´ä¸è¶³
- æƒé™é—®é¢˜
```

### 7.2 é‡è¯•å‚æ•°é…ç½®


**ğŸ”§ åŸºæœ¬é‡è¯•é…ç½®**
```bash
# /etc/rsyslog.conf
# å…¨å±€é‡è¯•è®¾ç½®
$ActionResumeRetryCount 5           # æœ€å¤šé‡è¯•5æ¬¡
$ActionResumeInterval 30            # é‡è¯•é—´éš”30ç§’

# é’ˆå¯¹ç‰¹å®šåŠ¨ä½œçš„é‡è¯•
*.* $$remote-server:514
$ActionResumeRetryCount -1          # -1è¡¨ç¤ºæ— é™é‡è¯•
$ActionResumeInterval 60            # é‡è¯•é—´éš”60ç§’
```

### 7.3 é«˜çº§é‡è¯•ç­–ç•¥


**âš¡ æŒ‡æ•°é€€é¿é‡è¯•**
```bash
# æ™ºèƒ½é‡è¯•é…ç½®
*.* $$log-server.example.com:514
$ActionQueueType LinkedList
$ActionQueueSize 50000
$ActionResumeRetryCount -1          # æ— é™é‡è¯•
$ActionResumeInterval 1             # åˆå§‹é—´éš”1ç§’
$ActionResumeRetryBackoff 2         # æŒ‡æ•°é€€é¿å› å­
$ActionResumeRetryMax 300           # æœ€å¤§é—´éš”5åˆ†é’Ÿ
```

> ğŸ“ˆ **æŒ‡æ•°é€€é¿åŸç†**  
> ç¬¬1æ¬¡é‡è¯•ï¼š1ç§’å  
> ç¬¬2æ¬¡é‡è¯•ï¼š2ç§’å  
> ç¬¬3æ¬¡é‡è¯•ï¼š4ç§’å  
> ...  
> æœ€ç»ˆç¨³å®šåœ¨5åˆ†é’Ÿé—´éš”

### 7.4 é˜Ÿåˆ—æŒä¹…åŒ–é‡è¯•


**ğŸ’¾ æŒä¹…åŒ–é˜Ÿåˆ—é…ç½®**
```bash
# ç¡®ä¿é‡è¯•æ•°æ®ä¸ä¸¢å¤±
*.* $$remote-server:514
$ActionQueueType LinkedList
$ActionQueueFileName retry_queue    # é˜Ÿåˆ—æŒä¹…åŒ–æ–‡ä»¶
$ActionQueueSize 100000
$ActionQueueSaveOnShutdown on       # å…³æœºä¿å­˜é˜Ÿåˆ—
$ActionQueueMaxFileSize 100M        # é˜Ÿåˆ—æ–‡ä»¶å¤§å°é™åˆ¶
```

### 7.5 é‡è¯•çŠ¶æ€ç›‘æ§


**ğŸ“Š ç›‘æ§é‡è¯•çŠ¶æ€**
```bash
# æŸ¥çœ‹é˜Ÿåˆ—æ–‡ä»¶ï¼ˆè¡¨ç¤ºæœ‰é‡è¯•ï¼‰
ls -la /var/spool/rsyslog/

# æŸ¥çœ‹rsyslogç»Ÿè®¡ä¿¡æ¯
grep -i "retry\|queue\|fail" /var/log/rsyslog.log

# å®æ—¶ç›‘æ§è¿æ¥çŠ¶æ€
netstat -an | grep :514
```

**ğŸ” æ•…éšœè¯Šæ–­**
```bash
# æµ‹è¯•ç›®æ ‡æœåŠ¡å™¨è¿æ¥
telnet log-server.example.com 514

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
rsyslogd -N1 -f /etc/rsyslog.conf    # æ£€æŸ¥é…ç½®è¯­æ³•
tail -f /var/log/rsyslog.log         # æŸ¥çœ‹è¿è¡Œæ—¥å¿—
```

---

## 8. ğŸš¦ é€Ÿç‡é™åˆ¶é…ç½®


### 8.1 ä¸ºä»€ä¹ˆéœ€è¦é€Ÿç‡é™åˆ¶


**é€Ÿç‡é™åˆ¶**é˜²æ­¢æŸä¸ªåº”ç”¨æˆ–æœåŠ¡äº§ç”Ÿè¿‡å¤šæ—¥å¿—ï¼Œå½±å“ç³»ç»Ÿæ€§èƒ½æˆ–å¡«æ»¡ç£ç›˜ç©ºé—´ã€‚

```
é€Ÿç‡é™åˆ¶åº”ç”¨åœºæ™¯ï¼š

æ— é™åˆ¶æƒ…å†µï¼š
åº”ç”¨é”™è¯¯ â†’ ç–¯ç‹‚å†™æ—¥å¿— â†’ ç£ç›˜æ»¡äº† â†’ ç³»ç»Ÿå´©æºƒ

æœ‰é™åˆ¶æƒ…å†µï¼š  
åº”ç”¨é”™è¯¯ â†’ å†™æ—¥å¿—å—é™ â†’ ç³»ç»Ÿæ­£å¸¸ â†’ ç®¡ç†å‘˜å¤„ç†

é™åˆ¶å¯¹è±¡ï¼š
- æŒ‰ç¨‹åºé™åˆ¶
- æŒ‰æ¶ˆæ¯å†…å®¹é™åˆ¶
- æŒ‰æ¥æºIPé™åˆ¶
- æŒ‰æ—¶é—´çª—å£é™åˆ¶
```

### 8.2 ç³»ç»Ÿçº§é€Ÿç‡é™åˆ¶


**âš™ï¸ å…¨å±€é€Ÿç‡é…ç½®**
```bash
# /etc/rsyslog.conf
# ç³»ç»Ÿçº§é€Ÿç‡é™åˆ¶
$SystemLogRateLimitInterval 5       # æ—¶é—´çª—å£5ç§’
$SystemLogRateLimitBurst 1000       # æ—¶é—´çª—å£å†…æœ€å¤š1000æ¡æ¶ˆæ¯

# è¶…å‡ºé™åˆ¶æ—¶çš„å¤„ç†
$SystemLogRateLimitSeverity 4       # åªé™åˆ¶infoçº§åˆ«ä»¥ä¸‹
```

### 8.3 ç¨‹åºçº§é€Ÿç‡é™åˆ¶


**ğŸ¯ é’ˆå¯¹ç‰¹å®šç¨‹åºé™åˆ¶**
```bash
# é™åˆ¶ç‰¹å®šç¨‹åºçš„æ—¥å¿—é€Ÿç‡
$ModLoad imuxsock
$IMUXSockRateLimitInterval 60       # 60ç§’çª—å£
$IMUXSockRateLimitBurst 200         # æ¯60ç§’æœ€å¤š200æ¡

# é’ˆå¯¹ä¸åŒç¨‹åºè®¾ç½®ä¸åŒé™åˆ¶
if $programname == 'nginx' then {
    *.* -/var/log/nginx-limited.log
    stop
} else if $programname == 'mysql' then {
    *.* -/var/log/mysql-limited.log  
    stop
}
```

### 8.4 åŸºäºå†…å®¹çš„é€Ÿç‡é™åˆ¶


**ğŸ“ é‡å¤æ¶ˆæ¯é™åˆ¶**
```bash
# é™åˆ¶é‡å¤æ¶ˆæ¯
$RepeatedMsgReduction on            # å¯ç”¨é‡å¤æ¶ˆæ¯åˆå¹¶
$RepeatedMsgContainsOriginalMsg off # ä¸åŒ…å«åŸå§‹æ¶ˆæ¯

# è‡ªå®šä¹‰é‡å¤æ£€æµ‹è§„åˆ™
if $msg contains "Connection failed" then {
    *.* -/var/log/connection-errors.log
    stop
}
```

### 8.5 ç½‘ç»œé€Ÿç‡é™åˆ¶


**ğŸŒ ç½‘ç»œä¼ è¾“é€Ÿç‡æ§åˆ¶**
```bash
# é™åˆ¶ç½‘ç»œä¼ è¾“é€Ÿç‡
*.* $$remote-server:514
$ActionQueueType LinkedList
$ActionQueueSize 1000               # é™åˆ¶é˜Ÿåˆ—å¤§å°
$ActionQueueDequeueSlowdown 100     # å‘é€å»¶è¿Ÿ100æ¯«ç§’
$ActionQueueTimeoutShutdown 10      # å…³æœºç­‰å¾…æ—¶é—´
```

### 8.6 é€Ÿç‡é™åˆ¶ç›‘æ§


**ğŸ“Š ç›‘æ§é™åˆ¶æ•ˆæœ**
```bash
# æŸ¥çœ‹è¢«é™åˆ¶çš„æ¶ˆæ¯
grep -i "rate\|limit\|burst" /var/log/rsyslog.log

# ç»Ÿè®¡ä¿¡æ¯é…ç½®
$ModLoad impstats
$PStatInterval 60
$PStatFile /var/log/rsyslog-stats.log

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
tail -f /var/log/rsyslog-stats.log | grep -i rate
```

---

## 9. ğŸ”§ è°ƒè¯•æ¨¡å¼ä¸æ•…éšœæ’æŸ¥


### 9.1 rsyslogè°ƒè¯•æ¨¡å¼


**è°ƒè¯•æ¨¡å¼**å¸®åŠ©æˆ‘ä»¬å‘ç°rsyslogé…ç½®é—®é¢˜å’Œè¿è¡Œæ•…éšœã€‚

### 9.2 å¯ç”¨è°ƒè¯•åŠŸèƒ½


**ğŸ” åŸºæœ¬è°ƒè¯•é…ç½®**
```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
$DebugLevel 2                       # è°ƒè¯•çº§åˆ«ï¼ˆ0-2ï¼‰
$DebugFile /var/log/rsyslog-debug.log

# æˆ–è€…å¯åŠ¨æ—¶æŒ‡å®šè°ƒè¯•
rsyslogd -f /etc/rsyslog.conf -d -n  # -dè°ƒè¯•æ¨¡å¼ï¼Œ-nå‰å°è¿è¡Œ
```

**ğŸ” è¯¦ç»†è°ƒè¯•ä¿¡æ¯**
```bash
# æ›´è¯¦ç»†çš„è°ƒè¯•
export RSYSLOG_DEBUGLOG="/var/log/rsyslog-debug.log"
export RSYSLOG_DEBUG="Debug"
systemctl restart rsyslog

# æŸ¥çœ‹è°ƒè¯•æ—¥å¿—
tail -f /var/log/rsyslog-debug.log
```

### 9.3 é…ç½®è¯­æ³•æ£€æŸ¥


**âœ… è¯­æ³•éªŒè¯å·¥å…·**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
rsyslogd -N1 -f /etc/rsyslog.conf

# è¾“å‡ºç¤ºä¾‹ï¼š
# rsyslogd: version 8.24.0, config validation run (level 1), master config /etc/rsyslog.conf
# rsyslogd: End of config validation run. Bye.  # è¡¨ç¤ºè¯­æ³•æ­£ç¡®
```

**ğŸ”§ å¸¸è§è¯­æ³•é”™è¯¯**
```bash
# é”™è¯¯ç¤ºä¾‹å’Œä¿®å¤
# é”™è¯¯ï¼šç¼ºå°‘å¼•å·
$template myTemplate,%timestamp% %hostname% %msg%
# æ­£ç¡®ï¼š
$template myTemplate,"%timestamp% %hostname% %msg%"

# é”™è¯¯ï¼šæ¨¡å—æœªåŠ è½½
*.* $$server:514    # ä½†æ²¡æœ‰ $ModLoad imtcp
# æ­£ç¡®ï¼š
$ModLoad imtcp
*.* $$server:514
```

### 9.4 ç½‘ç»œè¿æ¥è°ƒè¯•


**ğŸŒ ç½‘ç»œé—®é¢˜æ’æŸ¥**
```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep rsyslog
ss -tlnp | grep :514

# æµ‹è¯•ç½‘ç»œè¿æ¥
telnet log-server.example.com 514
nc -zv log-server.example.com 514

# æ£€æŸ¥é˜²ç«å¢™
iptables -L | grep 514
firewall-cmd --list-ports
```

### 9.5 æ—¥å¿—ä¼ è¾“è°ƒè¯•


**ğŸ“¡ ä¼ è¾“é—®é¢˜è¯Šæ–­**
```bash
# å¯ç”¨ä¼ è¾“è°ƒè¯•
*.* $$remote-server:514
$ActionExecOnlyWhenPreviousIsSuspended off
$ActionExecOnlyOnceEveryInterval 30    # æ¯30ç§’å‘é€ä¸€æ¬¡æµ‹è¯•

# æ‰‹åŠ¨å‘é€æµ‹è¯•æ—¥å¿—
logger -p local0.info "Test message from $(hostname)"

# ç›‘æ§ä¼ è¾“çŠ¶æ€
tcpdump -i eth0 port 514               # æŠ“å–ç½‘ç»œåŒ…
```

### 9.6 æ€§èƒ½é—®é¢˜è°ƒè¯•


**ğŸ“ˆ æ€§èƒ½è¯Šæ–­**
```bash
# å¯ç”¨æ€§èƒ½ç»Ÿè®¡
$ModLoad impstats
$PStatInterval 30                      # æ¯30ç§’è¾“å‡ºç»Ÿè®¡
$PStatFile /var/log/rsyslog-perf.log

# ç›‘æ§èµ„æºä½¿ç”¨
top -p $(pgrep rsyslogd)
iostat -x 1                           # ç£ç›˜I/Oç›‘æ§
```

### 9.7 å¸¸è§é—®é¢˜è§£å†³


**â— å¸¸è§æ•…éšœåŠè§£å†³æ–¹æ¡ˆ**

<details>
<summary>ğŸ”§ ç‚¹å‡»æŸ¥çœ‹å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</summary>

**é—®é¢˜1ï¼šæ—¥å¿—ä¸å†™å…¥æ–‡ä»¶**
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/log/
chown syslog:adm /var/log/myapp.log

# æ£€æŸ¥SELinux
getenforce
setsebool -P rsyslog_can_network_connect on
```

**é—®é¢˜2ï¼šè¿œç¨‹æ—¥å¿—æ¥æ”¶ä¸åˆ°**
```bash
# æ£€æŸ¥æœåŠ¡å™¨é…ç½®
$ModLoad imudp
$UDPServerRun 514

# æ£€æŸ¥é˜²ç«å¢™
firewall-cmd --add-port=514/udp --permanent
firewall-cmd --reload
```

**é—®é¢˜3ï¼šæ—¥å¿—é‡å¤**
```bash
# é¿å…é‡å¤å¤„ç†
*.* /var/log/messages
& stop                                 # æ·»åŠ stopæŒ‡ä»¤
```

**é—®é¢˜4ï¼šé˜Ÿåˆ—æ–‡ä»¶è¿‡å¤§**
```bash
# æ¸…ç†é˜Ÿåˆ—æ–‡ä»¶
systemctl stop rsyslog
rm -f /var/spool/rsyslog/*
systemctl start rsyslog
```
</details>

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒçŸ¥è¯†


```
ğŸ”¸ æ¨¡æ¿ç³»ç»Ÿï¼šè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œæ”¯æŒJSONã€CSVç­‰å¤šç§è¾“å‡º
ğŸ”¸ é˜Ÿåˆ—æœºåˆ¶ï¼šå†…å­˜+ç£ç›˜æ··åˆç¼“å†²ï¼Œæé«˜æ€§èƒ½å’Œå¯é æ€§  
ğŸ”¸ ç½‘ç»œä¼ è¾“ï¼šUDP/TCP/RELPä¸‰ç§åè®®ï¼Œé€‚åº”ä¸åŒåœºæ™¯
ğŸ”¸ TLSåŠ å¯†ï¼šä¿æŠ¤æ—¥å¿—ä¼ è¾“å®‰å…¨ï¼Œä¼ä¸šç¯å¢ƒå¿…å¤‡
ğŸ”¸ ç¼“å†²ç®¡ç†ï¼šåˆç†é…ç½®å†…å­˜å’Œç£ç›˜ç¼“å†²ï¼Œå¹³è¡¡æ€§èƒ½ä¸èµ„æº
ğŸ”¸ é‡è¯•æœºåˆ¶ï¼šç½‘ç»œæ•…éšœæ—¶è‡ªåŠ¨é‡è¯•ï¼Œç¡®ä¿æ—¥å¿—ä¸ä¸¢å¤±
ğŸ”¸ é€Ÿç‡é™åˆ¶ï¼šé˜²æ­¢æ—¥å¿—æ´ªæ°´ï¼Œä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§
ğŸ”¸ è°ƒè¯•æ’é”™ï¼šæŒæ¡è°ƒè¯•å·¥å…·ï¼Œå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜
```

### 10.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–åŸåˆ™**
```
å†…å­˜é˜Ÿåˆ—ï¼šé«˜æ€§èƒ½åœºæ™¯é¦–é€‰
ç£ç›˜é˜Ÿåˆ—ï¼šé«˜å¯é æ€§åœºæ™¯å¿…å¤‡  
æ··åˆé˜Ÿåˆ—ï¼šæ¨èçš„å¹³è¡¡æ–¹æ¡ˆ
çº¿ç¨‹æ•°é‡ï¼šé€šå¸¸è®¾ä¸ºCPUæ ¸å¿ƒæ•°1-2å€
```

**ğŸ”¹ ç½‘ç»œä¼ è¾“é€‰æ‹©**
```
UDPä¼ è¾“ï¼šé€Ÿåº¦å¿«ï¼Œé€‚åˆå†…ç½‘ç¯å¢ƒ
TCPä¼ è¾“ï¼šå¯é æ€§å¥½ï¼Œé€‚åˆé‡è¦æ—¥å¿—
RELPä¼ è¾“ï¼šæœ€å¯é ï¼Œä¼ä¸šçº§é¦–é€‰
TLSåŠ å¯†ï¼šå®‰å…¨è¦æ±‚é«˜æ—¶å¿…é¡»å¯ç”¨
```

**ğŸ”¹ æ•…éšœå¤„ç†ç­–ç•¥**
```
é˜Ÿåˆ—æŒä¹…åŒ–ï¼šé˜²æ­¢é‡å¯ä¸¢å¤±æ—¥å¿—
æ— é™é‡è¯•ï¼šç½‘ç»œæ•…éšœæ—¶ç¡®ä¿ä¼ è¾“
æŒ‡æ•°é€€é¿ï¼šé¿å…é¢‘ç¹é‡è¯•å½±å“æ€§èƒ½
çŠ¶æ€ç›‘æ§ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜
```

### 10.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ’¼ ä¼ä¸šçº§éƒ¨ç½²æ¨èé…ç½®**
```bash
# æ¨èçš„ä¼ä¸šçº§é…ç½®æ¨¡æ¿
$ModLoad imuxsock
$ModLoad imtcp
$InputTCPServerRun 514

# é˜Ÿåˆ—ä¼˜åŒ–
$MainMsgQueueType LinkedList
$MainMsgQueueSize 50000
$MainMsgQueueHighWaterMark 40000
$MainMsgQueueLowWaterMark 10000
$MainMsgQueueFileName main_queue
$MainMsgQueueMaxFileSize 100M
$MainMsgQueueSaveOnShutdown on

# TLSå®‰å…¨ä¼ è¾“
$DefaultNetstreamDriver gtls
$DefaultNetstreamDriverCAFile /etc/certs/ca.pem
$DefaultNetstreamDriverCertFile /etc/certs/server.pem
$DefaultNetstreamDriverKeyFile /etc/certs/server-key.pem

# é€Ÿç‡é™åˆ¶
$SystemLogRateLimitInterval 5
$SystemLogRateLimitBurst 1000

# æ€§èƒ½ç›‘æ§
$ModLoad impstats
$PStatInterval 60
$PStatFile /var/log/rsyslog-stats.log
```

**ğŸ¯ å­¦ä¹ é‡ç‚¹é¡ºåº**
1. **æŒæ¡æ¨¡æ¿ç³»ç»Ÿ** - è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼
2. **ç†è§£é˜Ÿåˆ—æœºåˆ¶** - æ€§èƒ½ä¼˜åŒ–åŸºç¡€  
3. **é…ç½®ç½‘ç»œä¼ è¾“** - é›†ä¸­åŒ–æ—¥å¿—ç®¡ç†
4. **å¯ç”¨TLSåŠ å¯†** - ä¿éšœä¼ è¾“å®‰å…¨
5. **è®¾ç½®é‡è¯•æœºåˆ¶** - æé«˜å¯é æ€§
6. **å­¦ä¼šè°ƒè¯•æ’é”™** - è§£å†³å®é™…é—®é¢˜

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ¨¡æ¿å®šä¹‰æ ¼å¼åŒ–ï¼Œé˜Ÿåˆ—ç¼“å†²ä¿æ€§èƒ½
ç½‘ç»œä¼ è¾“é€‰åè®®ï¼ŒTLSåŠ å¯†ä¿å®‰å…¨  
é‡è¯•æœºåˆ¶é˜²ä¸¢å¤±ï¼Œé€Ÿç‡é™åˆ¶é˜²æ´ªæ°´
è°ƒè¯•æ’é”™è¦ç†Ÿç»ƒï¼Œä¼ä¸šåº”ç”¨æ˜¾ç¥å¨
```