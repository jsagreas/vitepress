---
title: 5、用户账户初始设置
---
## 📚 目录

1. [用户账户管理概述](#1-用户账户管理概述)
2. [root账户安全策略配置](#2-root账户安全策略配置)
3. [普通用户创建与权限设置](#3-普通用户创建与权限设置)
4. [sudo权限初始配置](#4-sudo权限初始配置)
5. [密码策略设置](#5-密码策略设置)
6. [SSH密钥认证配置](#6-SSH密钥认证配置)
7. [用户环境变量初始化](#7-用户环境变量初始化)
8. [用户目录权限检查](#8-用户目录权限检查)
9. [账户锁定策略配置](#9-账户锁定策略配置)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 👤 用户账户管理概述


### 1.1 什么是用户账户管理


**简单理解**：用户账户管理就像是给房子配钥匙和门禁卡

```
现实生活中：                    Linux系统中：
房子主人 → 有所有权限            root用户 → 系统最高权限
租户 → 有限制的使用权限         普通用户 → 受限的系统权限
保安 → 负责安全检查             sudo机制 → 临时提权
门禁系统 → 控制进出权限         认证机制 → 登录验证
```

### 1.2 为什么要管理用户账户


**🔸 安全性保障**
- **防止误操作**：普通用户不能删除系统文件
- **权限隔离**：不同用户只能访问自己的文件
- **审计追踪**：知道谁做了什么操作

**🔸 系统稳定性**
- **资源控制**：限制用户使用的系统资源
- **进程隔离**：用户程序互不影响
- **备份恢复**：按用户备份重要数据

### 1.3 Linux用户类型


```
用户类型架构图：
├── root用户（超级管理员）
│   └── UID = 0，拥有所有权限
├── 系统用户（服务账户）
│   └── UID = 1-999，运行系统服务
└── 普通用户（真实用户）
    └── UID ≥ 1000，日常使用账户
```

---

## 2. 🔐 root账户安全策略配置


### 2.1 root账户的含义


**什么是root账户？**
- **超级管理员**：拥有系统所有权限的账户
- **UID为0**：系统通过UID=0识别root用户
- **无限制权限**：可以读写任何文件，执行任何操作

**为什么要保护root账户？**
```
root账户就像是房子的万能钥匙：
✅ 能开所有房间的门
✅ 能控制所有设备
❌ 一旦丢失，整个房子都不安全
❌ 使用不当，可能破坏整个房子
```

### 2.2 root账户安全配置


**🔸 禁用root直接SSH登录**

```bash
# 编辑SSH配置文件
sudo vim /etc/ssh/sshd_config

# 添加或修改以下配置
PermitRootLogin no           # 禁止root直接登录
PasswordAuthentication no    # 禁止密码认证（推荐密钥认证）

# 重启SSH服务
sudo systemctl restart sshd
```

**为什么要这样做？**
- **减少攻击面**：黑客无法直接尝试破解root密码
- **强制使用跳板**：必须先登录普通用户，再切换到root
- **审计记录**：能记录谁切换到了root

**🔸 设置root密码强度**

```bash
# 设置复杂的root密码
sudo passwd root
# 输入复杂密码：至少12位，包含大小写字母、数字、特殊字符
```

**🔸 配置root会话超时**

```bash
# 编辑环境配置
sudo vim /root/.bashrc

# 添加会话超时设置（10分钟无操作自动退出）
export TMOUT=600
```

### 2.3 root权限监控


**🔸 启用sudo日志记录**

```bash
# 编辑sudo配置
sudo visudo

# 添加日志配置
Defaults logfile="/var/log/sudo.log"
Defaults log_input,log_output
```

**监控什么？**
- **谁使用了sudo**：记录用户身份
- **执行了什么命令**：记录具体操作
- **什么时间执行**：记录时间戳

---

## 3. 👥 普通用户创建与权限设置


### 3.1 创建普通用户


**什么是普通用户？**
- **日常使用账户**：用于日常工作和操作
- **受限权限**：只能操作自己的文件和授权资源
- **安全隔离**：无法影响系统和其他用户

**🔸 创建用户的完整流程**

```bash
# 步骤1：创建用户（自动创建家目录）
sudo useradd -m -s /bin/bash username

# 步骤2：设置用户密码
sudo passwd username

# 步骤3：创建用户时指定更多信息
sudo useradd -m -s /bin/bash -c "张三,开发部" -G developers zhangsan
```

**参数含义解释：**
- `-m`：创建用户家目录（/home/username）
- `-s /bin/bash`：指定用户的默认Shell
- `-c`：添加用户描述信息
- `-G`：指定用户所属的附加组

### 3.2 用户权限设置原理


**Linux权限模型简单理解：**

```
权限控制就像是公司的门禁系统：
┌─────────────────────────────────┐
│ 文件权限（rwx）                  │
│ r = 读取权限（看文件内容）        │
│ w = 写入权限（修改文件内容）      │
│ x = 执行权限（运行程序文件）      │
└─────────────────────────────────┘
            ↓
┌─────────────────────────────────┐
│ 权限分配对象                     │
│ u = 用户本人（user）            │
│ g = 同组用户（group）           │
│ o = 其他用户（others）          │
└─────────────────────────────────┘
```

**🔸 查看和修改文件权限**

```bash
# 查看文件权限
ls -l /home/username/
# 输出示例：drwxr-xr-x 2 username username 4096 Jan 15 10:30 Documents

# 修改文件权限
chmod 755 /path/to/file    # 给用户全部权限，组和其他用户读取执行权限
chmod u+x script.sh       # 给用户添加执行权限
```

### 3.3 用户组管理


**什么是用户组？**
- **权限集合**：把有相同权限需求的用户放在一组
- **便于管理**：给组分配权限，组内用户自动获得
- **角色划分**：如开发组、运维组、财务组等

**🔸 用户组操作**

```bash
# 创建用户组
sudo groupadd developers

# 将用户添加到组
sudo usermod -aG developers username

# 查看用户所属的组
groups username

# 查看系统所有组
cat /etc/group
```

---

## 4. ⚡ sudo权限初始配置


### 4.1 sudo机制的含义


**什么是sudo？**
- **临时提权工具**：让普通用户临时获得管理员权限
- **安全机制**：不需要知道root密码就能执行管理员操作
- **审计功能**：记录谁执行了什么管理员命令

**生活中的类比：**
```
sudo就像是银行的临时授权：
普通员工 → 普通用户
需要管理员权限时 → 使用sudo
输入自己的工牌密码 → 输入自己的用户密码
临时获得权限 → 执行管理员命令
操作被记录 → sudo日志记录
```

### 4.2 配置sudo权限


**🔸 将用户添加到sudo组**

```bash
# 方法1：添加到sudo组（Ubuntu/Debian）
sudo usermod -aG sudo username

# 方法2：添加到wheel组（CentOS/RHEL）
sudo usermod -aG wheel username

# 验证用户sudo权限
sudo -l -U username
```

**🔸 自定义sudo权限配置**

```bash
# 编辑sudo配置文件（必须用visudo命令）
sudo visudo

# 添加具体的权限配置
# 格式：用户名 主机名=(运行身份) 允许的命令
username ALL=(ALL:ALL) ALL                    # 完全权限
webadmin ALL=(ALL) /usr/bin/systemctl         # 只能管理服务
backup ALL=(ALL) NOPASSWD: /usr/bin/rsync     # 执行备份命令时不需要密码
```

**权限配置含义：**
- `ALL=(ALL:ALL) ALL`：在所有主机上，以任何用户身份，执行任何命令
- `NOPASSWD:`：执行指定命令时不需要输入密码
- 具体命令路径：限制只能执行特定的命令

### 4.3 sudo最佳实践


**🔸 安全建议**

| 配置项 | 建议设置 | 说明 |
|-------|---------|------|
| **密码超时** | `timestamp_timeout=5` | 5分钟内再次使用sudo不需要重新输入密码 |
| **命令日志** | `log_input,log_output` | 记录sudo执行的所有输入输出 |
| **安全路径** | `secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"` | 限制sudo命令搜索路径 |

---

## 5. 🔑 密码策略设置


### 5.1 密码安全的重要性


**为什么要设置密码策略？**
- **防止弱密码**：避免用户设置123456这样的简单密码
- **定期更换**：定期强制用户更新密码
- **防止重用**：避免用户重复使用旧密码

### 5.2 配置密码复杂度要求


**🔸 安装密码强度检查工具**

```bash
# Ubuntu/Debian
sudo apt-get install libpam-pwquality

# CentOS/RHEL
sudo yum install libpwquality
```

**🔸 配置密码策略**

```bash
# 编辑PAM配置文件
sudo vim /etc/pam.d/common-password

# 添加密码复杂度要求
password requisite pam_pwquality.so retry=3 minlen=8 maxrepeat=2 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1
```

**参数含义解释：**
- `minlen=8`：密码最少8位
- `ucredit=-1`：至少包含1个大写字母
- `lcredit=-1`：至少包含1个小写字母
- `dcredit=-1`：至少包含1个数字
- `ocredit=-1`：至少包含1个特殊字符
- `maxrepeat=2`：相同字符最多连续出现2次

### 5.3 密码有效期设置


**🔸 配置密码过期策略**

```bash
# 编辑登录配置文件
sudo vim /etc/login.defs

# 设置密码策略
PASS_MAX_DAYS   90    # 密码最长90天必须更换
PASS_MIN_DAYS   7     # 密码更换后7天内不能再次更换
PASS_WARN_AGE   7     # 密码过期前7天开始警告用户
```

**🔸 为特定用户设置密码有效期**

```bash
# 设置用户密码90天后过期
sudo chage -M 90 username

# 查看用户密码信息
sudo chage -l username
```

---

## 6. 🔐 SSH密钥认证配置


### 6.1 SSH密钥认证的含义


**什么是SSH密钥认证？**
- **更安全的登录方式**：用密钥对代替密码登录
- **公钥私钥机制**：公钥放服务器，私钥保存在客户端
- **防暴力破解**：没有私钥文件无法登录

**密钥认证vs密码认证：**

```
密码认证：                    密钥认证：
用户输入密码 → 服务器验证     客户端用私钥签名 → 服务器用公钥验证
容易被暴力破解               几乎无法破解
每次都要输入密码             配置后自动登录
```

### 6.2 生成SSH密钥对


**🔸 在客户端生成密钥对**

```bash
# 生成RSA密钥对（推荐2048位或以上）
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# 生成过程中的选择：
# 1. 密钥保存位置：直接回车使用默认位置 ~/.ssh/id_rsa
# 2. 设置密钥密码：可以设置也可以留空（推荐设置）
```

**生成的文件：**
- `~/.ssh/id_rsa`：私钥文件（保密，不能泄露）
- `~/.ssh/id_rsa.pub`：公钥文件（可以公开）

### 6.3 配置服务器端


**🔸 将公钥复制到服务器**

```bash
# 方法1：使用ssh-copy-id命令（最简单）
ssh-copy-id username@server_ip

# 方法2：手动复制
# 在客户端查看公钥内容
cat ~/.ssh/id_rsa.pub

# 在服务器端创建authorized_keys文件
mkdir -p ~/.ssh
echo "公钥内容" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

**🔸 配置SSH服务器**

```bash
# 编辑SSH配置
sudo vim /etc/ssh/sshd_config

# 启用密钥认证，禁用密码认证
PubkeyAuthentication yes
PasswordAuthentication no
ChallengeResponseAuthentication no

# 重启SSH服务
sudo systemctl restart sshd
```

---

## 7. 🌐 用户环境变量初始化


### 7.1 什么是环境变量


**环境变量的含义：**
- **系统设置**：告诉系统和程序如何工作的配置信息
- **全局配置**：在整个用户会话中都有效的设置
- **程序查找**：程序启动时会读取这些配置

**生活中的类比：**
```
环境变量就像是个人的工作偏好设置：
PATH → 工具箱的位置（程序搜索路径）
HOME → 家的地址（用户主目录）
LANG → 使用的语言（系统语言设置）
EDITOR → 常用的编辑器（默认文本编辑器）
```

### 7.2 常用环境变量设置


**🔸 编辑用户环境配置文件**

```bash
# 编辑用户的bash配置文件
vim ~/.bashrc

# 添加常用环境变量
export PATH="$HOME/bin:$PATH"           # 添加个人程序目录到PATH
export EDITOR="vim"                     # 设置默认编辑器
export LANG="zh_CN.UTF-8"              # 设置中文环境
export HISTSIZE=10000                   # 增加命令历史记录数量
export HISTFILESIZE=20000               # 增加历史文件大小
```

**🔸 Java开发环境变量**

```bash
# 如果用户需要Java开发环境
export JAVA_HOME="/usr/lib/jvm/java-11-openjdk"
export PATH="$JAVA_HOME/bin:$PATH"
export CLASSPATH=".:$JAVA_HOME/lib"
```

### 7.3 让配置生效


**🔸 重新加载配置**

```bash
# 重新加载bashrc配置
source ~/.bashrc

# 或者重新登录用户
# 或者执行以下命令
exec bash
```

**🔸 验证环境变量**

```bash
# 查看特定环境变量
echo $PATH
echo $HOME
echo $EDITOR

# 查看所有环境变量
env | sort
```

---

## 8. 📁 用户目录权限检查


### 8.1 用户目录结构


**标准用户目录结构：**

```
/home/username/                 # 用户主目录
├── .bashrc                     # bash配置文件
├── .bash_history              # 命令历史记录
├── .ssh/                      # SSH配置目录
│   ├── authorized_keys        # SSH公钥文件
│   ├── id_rsa                 # SSH私钥
│   └── id_rsa.pub            # SSH公钥
├── Documents/                 # 文档目录
├── Downloads/                 # 下载目录
└── Desktop/                   # 桌面目录
```

### 8.2 检查目录权限


**🔸 检查主要目录权限**

```bash
# 检查用户主目录权限
ls -ld /home/username
# 应该显示：drwx------ （只有用户本人能访问）

# 检查SSH目录权限
ls -ld /home/username/.ssh
# 应该显示：drwx------ （700权限）

# 检查SSH密钥权限
ls -l /home/username/.ssh/
# authorized_keys应该是：-rw------- （600权限）
# 私钥文件应该是：-rw------- （600权限）
```

### 8.3 修正权限问题


**🔸 修复常见权限问题**

```bash
# 修复主目录权限
sudo chmod 700 /home/username

# 修复SSH目录权限
sudo chmod 700 /home/username/.ssh
sudo chmod 600 /home/username/.ssh/authorized_keys
sudo chmod 600 /home/username/.ssh/id_rsa
sudo chmod 644 /home/username/.ssh/id_rsa.pub

# 确保文件所有者正确
sudo chown -R username:username /home/username
```

**为什么要检查权限？**
- **安全性**：防止其他用户访问私人文件
- **SSH功能**：SSH对密钥文件权限要求严格，权限不对会登录失败
- **系统稳定性**：权限混乱可能导致程序运行异常

---

## 9. 🔒 账户锁定策略配置


### 9.1 什么是账户锁定策略


**账户锁定的含义：**
- **安全防护**：防止密码暴力破解攻击
- **自动保护**：连续输错密码后自动锁定账户
- **时间恢复**：锁定一段时间后自动解锁

**现实生活类比：**
```
账户锁定就像银行卡的安全机制：
连续输错密码3次 → 银行卡被锁定
等待一段时间或到银行解锁 → 账户锁定策略
```

### 9.2 配置登录失败锁定


**🔸 安装pam_faillock模块**

```bash
# Ubuntu/Debian
sudo apt-get install libpam-modules

# 模块通常已经包含在系统中
```

**🔸 配置账户锁定策略**

```bash
# 编辑PAM认证配置
sudo vim /etc/pam.d/common-auth

# 添加faillock配置
auth required pam_faillock.so preauth silent audit deny=3 unlock_time=600 fail_interval=900
auth [default=die] pam_faillock.so authfail audit deny=3 unlock_time=600 fail_interval=900
```

**参数说明：**
- `deny=3`：连续失败3次后锁定
- `unlock_time=600`：锁定10分钟（600秒）
- `fail_interval=900`：15分钟内的失败次数累计

### 9.3 账户锁定管理


**🔸 查看锁定状态**

```bash
# 查看用户锁定状态
sudo pam_faillock --user username

# 查看所有被锁定的用户
sudo pam_faillock
```

**🔸 手动解锁账户**

```bash
# 解锁特定用户
sudo pam_faillock --user username --reset

# 解锁所有用户
sudo pam_faillock --reset
```

### 9.4 SSH连接锁定保护


**🔸 配置SSH连接限制**

```bash
# 编辑SSH配置
sudo vim /etc/ssh/sshd_config

# 添加连接限制
MaxAuthTries 3                    # 最多3次认证尝试
MaxStartups 10:30:100            # 限制并发连接数
ClientAliveInterval 300          # 5分钟无活动断开连接
ClientAliveCountMax 2            # 最多发送2次保活消息

# 重启SSH服务
sudo systemctl restart sshd
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心概念


```
🔸 用户账户类型：root超级用户、系统用户、普通用户
🔸 权限模型：读写执行权限（rwx）+ 用户组权限管理
🔸 sudo机制：临时提权工具，安全审计功能
🔸 密码策略：复杂度要求 + 有效期管理
🔸 SSH密钥认证：公钥私钥机制，比密码更安全
🔸 环境变量：系统和程序的配置信息
🔸 目录权限：特别是SSH相关目录的权限要求
🔸 账户锁定：防暴力破解的安全机制
```

### 10.2 关键安全原则


**🔹 最小权限原则**
```
用户权限设置：
✅ 只给必需的权限，不给多余权限
✅ 普通用户日常工作，需要时才用sudo
✅ 定期检查和清理不必要的权限
```

**🔹 纵深防御原则**
```
多层安全保护：
第1层：强密码策略 → 防止弱密码
第2层：SSH密钥认证 → 防止暴力破解
第3层：账户锁定策略 → 自动防护机制
第4层：权限隔离 → 限制影响范围
```

### 10.3 实际操作检查清单


**🔸 新系统初始化检查清单**

- [ ] **root账户安全**
  - [ ] 设置复杂root密码
  - [ ] 禁用root SSH直接登录
  - [ ] 配置sudo日志记录

- [ ] **普通用户创建**
  - [ ] 创建日常使用的普通用户
  - [ ] 配置用户加入适当的用户组
  - [ ] 设置用户sudo权限

- [ ] **密码安全策略**
  - [ ] 配置密码复杂度要求
  - [ ] 设置密码有效期策略
  - [ ] 启用账户锁定保护

- [ ] **SSH安全配置**
  - [ ] 生成SSH密钥对
  - [ ] 配置密钥认证登录
  - [ ] 禁用SSH密码认证

- [ ] **用户环境配置**
  - [ ] 设置必要的环境变量
  - [ ] 检查用户目录权限
  - [ ] 配置用户shell环境

### 10.4 常见问题解决


**🔸 SSH无法使用密钥登录**
```bash
# 检查步骤：
1. 检查SSH密钥权限：chmod 600 ~/.ssh/id_rsa
2. 检查SSH目录权限：chmod 700 ~/.ssh
3. 检查authorized_keys权限：chmod 600 ~/.ssh/authorized_keys
4. 检查SSH服务配置：PubkeyAuthentication yes
```

**🔸 用户无法使用sudo**
```bash
# 解决方法：
1. 检查用户是否在sudo组：groups username
2. 添加用户到sudo组：sudo usermod -aG sudo username
3. 检查sudo配置：sudo visudo
```

**核心记忆口诀：**
- 用户账户分三类，权限管理要明确
- root安全是关键，sudo临时来提权
- 密码策略要设好，SSH密钥更安全
- 环境变量配置全，目录权限检查严
- 账户锁定防暴力，安全防线层层设