---
title: 11ã€æ—¥å¿—ç³»ç»Ÿé…ç½®ä¸è½®è½¬
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿæ—¥å¿—æœåŠ¡é…ç½®ç¡®è®¤](#1-ç³»ç»Ÿæ—¥å¿—æœåŠ¡é…ç½®ç¡®è®¤)
2. [æ—¥å¿—æ–‡ä»¶ä½ç½®ä¸æƒé™è®¾ç½®](#2-æ—¥å¿—æ–‡ä»¶ä½ç½®ä¸æƒé™è®¾ç½®)
3. [æ—¥å¿—è½®è½¬ç­–ç•¥é…ç½®](#3-æ—¥å¿—è½®è½¬ç­–ç•¥é…ç½®)
4. [æ—¥å¿—çº§åˆ«ä¸è®°å½•ç­–ç•¥](#4-æ—¥å¿—çº§åˆ«ä¸è®°å½•ç­–ç•¥)
5. [è¿œç¨‹æ—¥å¿—ä¼ è¾“é…ç½®åŸºç¡€](#5-è¿œç¨‹æ—¥å¿—ä¼ è¾“é…ç½®åŸºç¡€)
6. [æ—¥å¿—å­˜å‚¨ç©ºé—´ç®¡ç†](#6-æ—¥å¿—å­˜å‚¨ç©ºé—´ç®¡ç†)
7. [ç³»ç»Ÿå®¡è®¡æ—¥å¿—é…ç½®](#7-ç³»ç»Ÿå®¡è®¡æ—¥å¿—é…ç½®)
8. [æ—¥å¿—æ•…éšœæ’æŸ¥æ–¹æ³•](#8-æ—¥å¿—æ•…éšœæ’æŸ¥æ–¹æ³•)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“‹ ç³»ç»Ÿæ—¥å¿—æœåŠ¡é…ç½®ç¡®è®¤


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿæ—¥å¿—æœåŠ¡


**ç®€å•ç†è§£**ï¼šæ—¥å¿—æœåŠ¡å°±åƒç³»ç»Ÿçš„"è®°å½•å‘˜"ï¼Œä¸“é—¨è´Ÿè´£è®°å½•ç³»ç»Ÿå‘ç”Ÿçš„å„ç§äº‹ä»¶ã€‚

```
ç°å®ç±»æ¯”ï¼š
åŒ»é™¢ç—…å†ç³»ç»Ÿ â†’ è®°å½•ç—…äººçš„æ‰€æœ‰è¯Šç–—ä¿¡æ¯
ç³»ç»Ÿæ—¥å¿—æœåŠ¡ â†’ è®°å½•ç³»ç»Ÿçš„æ‰€æœ‰è¿è¡Œä¿¡æ¯

ä½œç”¨ï¼š
- è®°å½•ç³»ç»Ÿå¯åŠ¨ã€å…³é—­ä¿¡æ¯
- è®°å½•ç”¨æˆ·ç™»å½•ã€é€€å‡ºä¿¡æ¯  
- è®°å½•åº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶æ€
- è®°å½•é”™è¯¯å’Œå¼‚å¸¸ä¿¡æ¯
```

### 1.2 ä¸»æµæ—¥å¿—æœåŠ¡å¯¹æ¯”


**ç°ä»£Linuxç³»ç»Ÿçš„ä¸¤å¤§æ—¥å¿—æœåŠ¡**ï¼š

| æœåŠ¡ç±»å‹ | **ä¼ ç»Ÿsyslog** | **ç°ä»£systemd-journald** |
|---------|---------------|-------------------------|
| ğŸ”§ **é…ç½®æ–‡ä»¶** | `/etc/rsyslog.conf` | `/etc/systemd/journald.conf` |
| ğŸ“ **å­˜å‚¨æ ¼å¼** | `æ–‡æœ¬æ–‡ä»¶` | `äºŒè¿›åˆ¶æ ¼å¼` |
| ğŸ” **æŸ¥çœ‹å·¥å…·** | `catã€tailã€grep` | `journalctl` |
| âš¡ **æ€§èƒ½** | `è¾ƒæ…¢` | `æ›´å¿«` |
| ğŸ¯ **ä½¿ç”¨åœºæ™¯** | `ä¼ ç»ŸæœåŠ¡å™¨` | `ç°ä»£Linuxå‘è¡Œç‰ˆ` |

### 1.3 æ£€æŸ¥å½“å‰æ—¥å¿—æœåŠ¡çŠ¶æ€


**ç¬¬ä¸€æ­¥ï¼šç¡®è®¤ç³»ç»Ÿä½¿ç”¨çš„æ—¥å¿—æœåŠ¡**

```bash
# æ£€æŸ¥systemd-journaldæœåŠ¡çŠ¶æ€
systemctl status systemd-journald

# æ£€æŸ¥rsyslogæœåŠ¡çŠ¶æ€  
systemctl status rsyslog

# æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨çš„æ—¥å¿—æœåŠ¡
ps aux | grep -E "(rsyslog|systemd-journal)"
```

**ç†è§£è¾“å‡ºç»“æœ**ï¼š
```bash
# å¦‚æœçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼Œè¯´æ˜systemd-journaldåœ¨è¿è¡Œ
â— systemd-journald.service - Journal Service
   Active: active (running) since Mon 2025-01-15 10:00:00 CST
   
# å¦‚æœçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼Œè¯´æ˜rsyslogåœ¨è¿è¡Œ
â— rsyslog.service - System Logging Service  
   Active: active (running) since Mon 2025-01-15 10:00:00 CST
```

### 1.4 æ—¥å¿—æœåŠ¡é…ç½®æ–‡ä»¶è¯¦è§£


**systemd-journaldé…ç½®**ï¼š

```bash
# ä¸»é…ç½®æ–‡ä»¶ä½ç½®
/etc/systemd/journald.conf

# æŸ¥çœ‹é…ç½®å†…å®¹
sudo cat /etc/systemd/journald.conf
```

**æ ¸å¿ƒé…ç½®é¡¹è§£é‡Š**ï¼š
```ini
# å­˜å‚¨æ–¹å¼è®¾ç½®
Storage=persistent      # persistentï¼šæŒä¹…å­˜å‚¨åˆ°ç£ç›˜
                       # volatileï¼šåªå­˜å‚¨åœ¨å†…å­˜ä¸­
                       # autoï¼šè‡ªåŠ¨é€‰æ‹©

# æ—¥å¿—æ–‡ä»¶å¤§å°é™åˆ¶
SystemMaxUse=100M      # ç³»ç»Ÿæ—¥å¿—æœ€å¤§å ç”¨ç©ºé—´
RuntimeMaxUse=100M     # è¿è¡Œæ—¶æ—¥å¿—æœ€å¤§å ç”¨ç©ºé—´

# æ—¥å¿—ä¿ç•™æ—¶é—´
MaxRetentionSec=1month # ä¿ç•™1ä¸ªæœˆçš„æ—¥å¿—
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼š
> - `persistent`æ¨¡å¼ä¸‹ï¼Œæ—¥å¿—ä¼šä¿å­˜åˆ°ç£ç›˜ï¼Œé‡å¯åä»ç„¶å­˜åœ¨
> - `volatile`æ¨¡å¼ä¸‹ï¼Œæ—¥å¿—åªåœ¨å†…å­˜ä¸­ï¼Œé‡å¯åä¸¢å¤±
> - `auto`æ¨¡å¼ä¼šæ ¹æ®æ˜¯å¦å­˜åœ¨`/var/log/journal`ç›®å½•æ¥å†³å®š

---

## 2. ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®ä¸æƒé™è®¾ç½®


### 2.1 ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶çš„æ ‡å‡†ä½ç½®


**æ ¸å¿ƒæ—¥å¿—ç›®å½•ç»“æ„**ï¼š

```
/var/log/ ç›®å½•ç»“æ„ï¼š
â”œâ”€â”€ messages        â† ç³»ç»Ÿé€šç”¨æ—¥å¿—ï¼ˆæœ€é‡è¦ï¼‰
â”œâ”€â”€ syslog         â† ç³»ç»Ÿæ—¥å¿—ï¼ˆUbuntu/Debianï¼‰
â”œâ”€â”€ auth.log       â† è®¤è¯æ—¥å¿—
â”œâ”€â”€ kern.log       â† å†…æ ¸æ—¥å¿—
â”œâ”€â”€ boot.log       â† å¯åŠ¨æ—¥å¿—
â”œâ”€â”€ cron.log       â† å®šæ—¶ä»»åŠ¡æ—¥å¿—
â”œâ”€â”€ maillog        â† é‚®ä»¶ç³»ç»Ÿæ—¥å¿—
â””â”€â”€ secure         â† å®‰å…¨ç›¸å…³æ—¥å¿—ï¼ˆCentOS/RHELï¼‰
```

**é‡è¦æ—¥å¿—æ–‡ä»¶è¯´æ˜**ï¼š

| æ—¥å¿—æ–‡ä»¶ | **ä½œç”¨è¯´æ˜** | **å…¸å‹å†…å®¹** |
|---------|-------------|-------------|
| ğŸ“‹ **messages** | `ç³»ç»Ÿä¸»è¦æ—¥å¿—ï¼Œè®°å½•å¤§éƒ¨åˆ†ç³»ç»Ÿæ¶ˆæ¯` | `æœåŠ¡å¯åŠ¨ã€ç¡¬ä»¶ä¿¡æ¯ã€å†…æ ¸æ¶ˆæ¯` |
| ğŸ” **auth.log** | `ç”¨æˆ·è®¤è¯ç›¸å…³æ—¥å¿—` | `ç™»å½•æˆåŠŸ/å¤±è´¥ã€sudoä½¿ç”¨è®°å½•` |
| âš™ï¸ **kern.log** | `å†…æ ¸ç›¸å…³æ—¥å¿—` | `ç¡¬ä»¶é©±åŠ¨ã€ç³»ç»Ÿè°ƒç”¨ã€å†…æ ¸é”™è¯¯` |
| ğŸš€ **boot.log** | `ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹æ—¥å¿—` | `æœåŠ¡å¯åŠ¨é¡ºåºã€å¯åŠ¨é”™è¯¯ä¿¡æ¯` |

### 2.2 æ—¥å¿—æ–‡ä»¶æƒé™è®¾ç½®


**æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æƒé™**ï¼š

```bash
# æŸ¥çœ‹ä¸»è¦æ—¥å¿—æ–‡ä»¶æƒé™
ls -la /var/log/messages /var/log/auth.log /var/log/syslog

# å…¸å‹è¾“å‡ºç¤ºä¾‹ï¼š
# -rw-r----- 1 syslog adm 145678 Jan 15 10:30 /var/log/syslog
# -rw-r----- 1 root   adm 123456 Jan 15 10:25 /var/log/auth.log
```

**æƒé™å«ä¹‰è§£é‡Š**ï¼š
```
-rw-r-----  æ„æ€æ˜¯ï¼š
- ç¬¬ä¸€ä½ -ï¼šè¡¨ç¤ºè¿™æ˜¯æ™®é€šæ–‡ä»¶
- rwxï¼ˆæ‹¥æœ‰è€…ï¼‰ï¼šrw- è¡¨ç¤ºæ‹¥æœ‰è€…å¯è¯»å¯å†™ï¼Œä¸å¯æ‰§è¡Œ
- rwxï¼ˆç»„ç”¨æˆ·ï¼‰ï¼šr-- è¡¨ç¤ºç»„ç”¨æˆ·åªèƒ½è¯»å–
- rwxï¼ˆå…¶ä»–ç”¨æˆ·ï¼‰ï¼š--- è¡¨ç¤ºå…¶ä»–ç”¨æˆ·æ— ä»»ä½•æƒé™
```

**è®¾ç½®æ­£ç¡®çš„æ—¥å¿—æ–‡ä»¶æƒé™**ï¼š

```bash
# è®¾ç½®messagesæ–‡ä»¶æƒé™ï¼ˆrootæ‹¥æœ‰ï¼Œadmç»„å¯è¯»ï¼‰
sudo chmod 640 /var/log/messages
sudo chown root:adm /var/log/messages

# è®¾ç½®auth.logæƒé™ï¼ˆæ›´ä¸¥æ ¼ï¼Œåªæœ‰rootå’Œadmç»„å¯è¯»ï¼‰
sudo chmod 640 /var/log/auth.log  
sudo chown root:adm /var/log/auth.log
```

> âš ï¸ **å®‰å…¨æé†’**ï¼š
> æ—¥å¿—æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ç™»å½•è®°å½•ï¼‰ï¼Œæƒé™è®¾ç½®è¿‡æ¾å¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²

### 2.3 åˆ›å»ºè‡ªå®šä¹‰æ—¥å¿—ç›®å½•


**ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºä¸“ç”¨æ—¥å¿—ç›®å½•**ï¼š

```bash
# åˆ›å»ºåº”ç”¨æ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/myapp

# è®¾ç½®ç›®å½•æƒé™
sudo chmod 755 /var/log/myapp
sudo chown myapp:myapp /var/log/myapp

# åˆ›å»ºæ—¥å¿—æ–‡ä»¶å¹¶è®¾ç½®æƒé™
sudo touch /var/log/myapp/app.log
sudo chmod 644 /var/log/myapp/app.log
sudo chown myapp:myapp /var/log/myapp/app.log
```

---

## 3. ğŸ”„ æ—¥å¿—è½®è½¬ç­–ç•¥é…ç½®


### 3.1 ä»€ä¹ˆæ˜¯æ—¥å¿—è½®è½¬


**ç®€å•ç†è§£**ï¼šæ—¥å¿—è½®è½¬å°±åƒæ¢æ–°æœ¬å­å†™æ—¥è®°ï¼Œé˜²æ­¢ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å˜å¾—å¤ªå¤§ã€‚

```
ç°å®ç±»æ¯”ï¼š
å­¦ç”Ÿæ¢æ–°ç»ƒä¹ æœ¬ï¼š
- æ—§æœ¬å­å†™æ»¡äº† â†’ æ”¶èµ·æ¥ä¿å­˜
- æ‹¿æ–°æœ¬å­ç»§ç»­å†™ â†’ ä¿æŒä½¿ç”¨ä½“éªŒ
- å®šæœŸæ¸…ç†æ—§æœ¬å­ â†’ èŠ‚çœå­˜å‚¨ç©ºé—´

æ—¥å¿—è½®è½¬è¿‡ç¨‹ï¼š
- æ—§æ—¥å¿—æ–‡ä»¶é‡å‘½å â†’ messages.1, messages.2
- åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ â†’ messages  
- å®šæœŸåˆ é™¤æœ€æ—§çš„æ—¥å¿— â†’ èŠ‚çœç£ç›˜ç©ºé—´
```

### 3.2 logrotateå·¥å…·è¯¦è§£


**logrotateé…ç½®æ–‡ä»¶ç»“æ„**ï¼š

```
logrotateé…ç½®ä½“ç³»ï¼š
/etc/logrotate.conf     â† ä¸»é…ç½®æ–‡ä»¶ï¼ˆå…¨å±€è®¾ç½®ï¼‰
/etc/logrotate.d/       â† å…·ä½“åº”ç”¨é…ç½®ç›®å½•
â”œâ”€â”€ rsyslog            â† ç³»ç»Ÿæ—¥å¿—è½®è½¬é…ç½®
â”œâ”€â”€ apache2            â† Apacheæ—¥å¿—è½®è½¬é…ç½®  
â”œâ”€â”€ nginx              â† Nginxæ—¥å¿—è½®è½¬é…ç½®
â””â”€â”€ mysql              â† MySQLæ—¥å¿—è½®è½¬é…ç½®
```

**æŸ¥çœ‹ä¸»é…ç½®æ–‡ä»¶**ï¼š

```bash
# æŸ¥çœ‹å…¨å±€é…ç½®
sudo cat /etc/logrotate.conf
```

**ä¸»é…ç½®æ–‡ä»¶å…³é”®è®¾ç½®**ï¼š
```bash
# è½®è½¬å‘¨æœŸ
weekly                  # æ¯å‘¨è½®è½¬ä¸€æ¬¡ï¼ˆè¿˜å¯ä»¥æ˜¯dailyã€monthlyï¼‰

# ä¿ç•™æ•°é‡  
rotate 4               # ä¿ç•™4ä¸ªè½®è½¬åçš„æ–‡ä»¶

# åˆ›å»ºæ–°æ–‡ä»¶
create                 # è½®è½¬ååˆ›å»ºæ–°çš„ç©ºæ—¥å¿—æ–‡ä»¶

# å‹ç¼©è®¾ç½®
compress               # å‹ç¼©è½®è½¬åçš„æ—¥å¿—æ–‡ä»¶
delaycompress          # å»¶è¿Ÿä¸€ä¸ªå‘¨æœŸå†å‹ç¼©ï¼ˆä¿ç•™æœ€æ–°çš„ä¸€ä¸ªä¸å‹ç¼©ï¼‰
```

### 3.3 é…ç½®ç³»ç»Ÿæ—¥å¿—è½®è½¬


**ç¼–è¾‘rsyslogçš„è½®è½¬é…ç½®**ï¼š

```bash
# ç¼–è¾‘ç³»ç»Ÿæ—¥å¿—è½®è½¬é…ç½®
sudo nano /etc/logrotate.d/rsyslog
```

**å…¸å‹é…ç½®ç¤ºä¾‹**ï¼š
```bash
/var/log/syslog {
    daily               # æ¯å¤©è½®è½¬
    missingok           # æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¸æŠ¥é”™
    rotate 7            # ä¿ç•™7å¤©çš„æ—¥å¿—
    compress            # å‹ç¼©æ—§æ—¥å¿—
    delaycompress       # æœ€æ–°çš„ä¸€ä¸ªä¸å‹ç¼©
    notifempty          # ç©ºæ–‡ä»¶ä¸è½®è½¬
    create 640 syslog adm    # åˆ›å»ºæ–°æ–‡ä»¶çš„æƒé™å’Œæ‰€æœ‰è€…
    postrotate               # è½®è½¬åæ‰§è¡Œçš„å‘½ä»¤
        /usr/lib/rsyslog/rsyslog-rotate
    endscript
}

/var/log/mail.info
/var/log/mail.warn  
/var/log/mail.err
/var/log/mail.log {
    daily
    missingok
    rotate 4
    compress
    delaycompress  
    notifempty
    create 640 syslog adm
}
```

**é…ç½®é€‰é¡¹è¯¦è§£**ï¼š

| é€‰é¡¹ | **å«ä¹‰** | **ä½œç”¨è¯´æ˜** |
|-----|---------|-------------|
| ğŸ“… **daily** | `æ¯å¤©è½®è½¬` | `é€‚åˆæ—¥å¿—é‡å¤§çš„ç³»ç»Ÿ` |
| ğŸ“… **weekly** | `æ¯å‘¨è½®è½¬` | `é€‚åˆæ—¥å¿—é‡ä¸­ç­‰çš„ç³»ç»Ÿ` |
| ğŸ“… **monthly** | `æ¯æœˆè½®è½¬` | `é€‚åˆæ—¥å¿—é‡å°çš„ç³»ç»Ÿ` |
| ğŸ”¢ **rotate N** | `ä¿ç•™Nä¸ªæ–‡ä»¶` | `N=7è¡¨ç¤ºä¿ç•™ä¸€å‘¨çš„æ—¥å¿—` |
| ğŸ—œï¸ **compress** | `å‹ç¼©æ—§æ–‡ä»¶` | `èŠ‚çœç£ç›˜ç©ºé—´` |
| ğŸ“ **create** | `åˆ›å»ºæ–°æ–‡ä»¶` | `æŒ‡å®šæ–°æ–‡ä»¶çš„æƒé™` |

### 3.4 æ‰‹åŠ¨æµ‹è¯•æ—¥å¿—è½®è½¬


**æµ‹è¯•è½®è½¬é…ç½®æ˜¯å¦æ­£ç¡®**ï¼š

```bash
# æµ‹è¯•æ‰€æœ‰æ—¥å¿—è½®è½¬é…ç½®ï¼ˆæ¨¡æ‹Ÿè¿è¡Œï¼Œä¸å®é™…æ‰§è¡Œï¼‰
sudo logrotate -d /etc/logrotate.conf

# å¼ºåˆ¶æ‰§è¡Œä¸€æ¬¡æ—¥å¿—è½®è½¬
sudo logrotate -f /etc/logrotate.conf

# æµ‹è¯•ç‰¹å®šçš„é…ç½®æ–‡ä»¶
sudo logrotate -d /etc/logrotate.d/rsyslog
```

**æŸ¥çœ‹è½®è½¬æ•ˆæœ**ï¼š
```bash
# æŸ¥çœ‹è½®è½¬åçš„æ–‡ä»¶
ls -la /var/log/syslog*

# å…¸å‹è¾“å‡ºï¼š
# -rw-r----- 1 syslog adm    1234 Jan 15 10:30 syslog
# -rw-r----- 1 syslog adm   12345 Jan 14 23:59 syslog.1
# -rw-r----- 1 syslog adm  123456 Jan 13 23:59 syslog.2.gz
```

---

## 4. ğŸ“Š æ—¥å¿—çº§åˆ«ä¸è®°å½•ç­–ç•¥


### 4.1 ç³»ç»Ÿæ—¥å¿—çº§åˆ«è¯¦è§£


**æ—¥å¿—çº§åˆ«å°±åƒåŒ»é™¢çš„ç—…æƒ…ç­‰çº§**ï¼Œç”¨æ¥åŒºåˆ†äº‹ä»¶çš„é‡è¦ç¨‹åº¦ï¼š

```
æ—¥å¿—çº§åˆ«å¯¹æ¯”ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
ğŸš¨ EMERGENCY (0) â†’ ç³»ç»Ÿä¸å¯ç”¨     â†’ åƒå¿ƒè„éª¤åœ
ğŸ”¥ ALERT (1)     â†’ å¿…é¡»ç«‹å³å¤„ç†   â†’ åƒé«˜çƒ§40åº¦  
ğŸ’¥ CRITICAL (2)  â†’ ä¸¥é‡é”™è¯¯       â†’ åƒéª¨æŠ˜
âŒ ERROR (3)     â†’ ä¸€èˆ¬é”™è¯¯       â†’ åƒæ„Ÿå†’å‘çƒ§
âš ï¸ WARNING (4)   â†’ è­¦å‘Šä¿¡æ¯       â†’ åƒè½»å¾®ä¸é€‚
ğŸ“‹ NOTICE (5)    â†’ æ­£å¸¸ä½†é‡è¦     â†’ åƒä½“æ£€æŠ¥å‘Š
â„¹ï¸ INFO (6)      â†’ ä¸€èˆ¬ä¿¡æ¯       â†’ åƒæ—¥å¸¸è®°å½•
ğŸ”§ DEBUG (7)     â†’ è°ƒè¯•ä¿¡æ¯       â†’ åƒè¯¦ç»†æ£€æŸ¥
```

### 4.2 rsyslogæ—¥å¿—è®°å½•ç­–ç•¥


**ç¼–è¾‘rsyslogé…ç½®æ–‡ä»¶**ï¼š

```bash
# ç¼–è¾‘ä¸»é…ç½®æ–‡ä»¶
sudo nano /etc/rsyslog.conf
```

**é…ç½®æ–‡ä»¶è¯­æ³•è§£é‡Š**ï¼š
```bash
# è¯­æ³•æ ¼å¼ï¼šè®¾æ–½.çº§åˆ«    ç›®æ ‡ä½ç½®
# facility.priority    action

# åŸºæœ¬é…ç½®ç¤ºä¾‹ï¼š
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
# è§£é‡Šï¼šæ‰€æœ‰è®¾æ–½çš„infoçº§åˆ«ä»¥ä¸Šæ—¥å¿—ï¼Œä½†æ’é™¤mailã€authprivã€cron

authpriv.*                                   /var/log/secure  
# è§£é‡Šï¼šæ‰€æœ‰è®¤è¯ç›¸å…³çš„æ—¥å¿—éƒ½è®°å½•åˆ°secureæ–‡ä»¶

mail.*                                       /var/log/maillog
# è§£é‡Šï¼šæ‰€æœ‰é‚®ä»¶ç›¸å…³çš„æ—¥å¿—éƒ½è®°å½•åˆ°maillogæ–‡ä»¶

cron.*                                       /var/log/cron
# è§£é‡Šï¼šæ‰€æœ‰å®šæ—¶ä»»åŠ¡ç›¸å…³çš„æ—¥å¿—éƒ½è®°å½•åˆ°cronæ–‡ä»¶
```

**å¸¸ç”¨è®¾æ–½ï¼ˆFacilityï¼‰ç±»å‹**ï¼š

| è®¾æ–½åç§° | **æ•°å­—ä»£ç ** | **ç”¨é€”è¯´æ˜** |
|---------|-------------|-------------|
| ğŸ  **local0-7** | `16-23` | `ç”¨æˆ·è‡ªå®šä¹‰è®¾æ–½` |
| ğŸ“§ **mail** | `2` | `é‚®ä»¶ç³»ç»Ÿ` |
| ğŸ” **authpriv** | `10` | `è®¤è¯å’Œæˆæƒ` |
| â° **cron** | `9` | `å®šæ—¶ä»»åŠ¡` |
| âš™ï¸ **daemon** | `3` | `ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹` |
| ğŸ–¥ï¸ **kern** | `0` | `å†…æ ¸æ¶ˆæ¯` |

### 4.3 è‡ªå®šä¹‰æ—¥å¿—è®°å½•ç­–ç•¥


**ä¸ºåº”ç”¨ç¨‹åºé…ç½®ä¸“ç”¨æ—¥å¿—**ï¼š

```bash
# åœ¨rsyslog.confä¸­æ·»åŠ è‡ªå®šä¹‰é…ç½®
echo "local0.*    /var/log/myapp.log" | sudo tee -a /etc/rsyslog.conf

# é‡å¯rsyslogæœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
sudo systemctl restart rsyslog
```

**åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ—¥å¿—**ï¼š

```bash
# ä½¿ç”¨loggerå‘½ä»¤å‘é€æµ‹è¯•æ—¥å¿—
logger -p local0.info "MyApp started successfully"
logger -p local0.error "MyApp encountered an error"
logger -p local0.warning "MyApp configuration warning"

# æŸ¥çœ‹æ—¥å¿—ç»“æœ
tail /var/log/myapp.log
```

### 4.4 systemd-journaldæ—¥å¿—çº§åˆ«é…ç½®


**é…ç½®journaldçš„è®°å½•ç­–ç•¥**ï¼š

```bash
# ç¼–è¾‘journaldé…ç½®
sudo nano /etc/systemd/journald.conf
```

**å…³é”®é…ç½®é€‰é¡¹**ï¼š
```ini
[Journal]
# æ—¥å¿—çº§åˆ«è®¾ç½®
MaxLevelStore=info      # å­˜å‚¨åˆ°ç£ç›˜çš„æœ€é«˜çº§åˆ«
MaxLevelSyslog=info     # è½¬å‘åˆ°syslogçš„æœ€é«˜çº§åˆ«
MaxLevelWall=emerg      # å‘é€åˆ°ç»ˆç«¯çš„æœ€é«˜çº§åˆ«

# æ—¥å¿—è¿‡æ»¤
RateLimitBurst=1000     # é™åˆ¶çªå‘æ—¥å¿—æ•°é‡
RateLimitIntervalSec=30s # é™åˆ¶æ—¶é—´çª—å£
```

**é‡æ–°åŠ è½½é…ç½®**ï¼š
```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# é‡å¯journaldæœåŠ¡
sudo systemctl restart systemd-journald
```

---

## 5. ğŸŒ è¿œç¨‹æ—¥å¿—ä¼ è¾“é…ç½®åŸºç¡€


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦è¿œç¨‹æ—¥å¿—


**è¿œç¨‹æ—¥å¿—çš„é‡è¦æ€§**ï¼š

```
ç°å®åœºæ™¯ç†è§£ï¼š
å•å°æœåŠ¡å™¨ â†’ åƒä¸€ä¸ªäººçš„æ—¥è®°æœ¬ï¼Œåªèƒ½è‡ªå·±çœ‹
å¤šå°æœåŠ¡å™¨ â†’ åƒä¸€ä¸ªå›¢é˜Ÿï¼Œéœ€è¦ç»Ÿä¸€æ±‡æŠ¥å·¥ä½œ

è¿œç¨‹æ—¥å¿—çš„å¥½å¤„ï¼š
ğŸ¯ é›†ä¸­ç®¡ç†ï¼šæ‰€æœ‰æœåŠ¡å™¨æ—¥å¿—é›†ä¸­åˆ°ä¸€å°æœºå™¨
ğŸ”’ æ•°æ®å®‰å…¨ï¼šå³ä½¿æŸå°æœåŠ¡å™¨åäº†ï¼Œæ—¥å¿—ä¹Ÿä¸ä¼šä¸¢å¤±
ğŸ“Š åˆ†æä¾¿åˆ©ï¼šå¯ä»¥ç»Ÿä¸€åˆ†ææ‰€æœ‰æœåŠ¡å™¨çš„æƒ…å†µ
ğŸš¨ åŠæ—¶å‘Šè­¦ï¼šå¯ä»¥å®æ—¶ç›‘æ§æ‰€æœ‰æœåŠ¡å™¨çŠ¶æ€
```

### 5.2 é…ç½®rsyslogè¿œç¨‹ä¼ è¾“


**æœåŠ¡å™¨ç«¯ï¼ˆæ—¥å¿—æ”¶é›†æœåŠ¡å™¨ï¼‰é…ç½®**ï¼š

```bash
# ç¼–è¾‘rsyslogé…ç½®æ–‡ä»¶
sudo nano /etc/rsyslog.conf

# å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œä»¥å¯ç”¨UDPæ¥æ”¶ï¼ˆé»˜è®¤514ç«¯å£ï¼‰
$ModLoad imudp
$UDPServerRun 514

# æˆ–è€…å¯ç”¨TCPæ¥æ”¶ï¼ˆæ›´å¯é ï¼‰
$ModLoad imtcp  
$InputTCPServerRun 514
```

**å®¢æˆ·ç«¯ï¼ˆå‘é€æ—¥å¿—çš„æœåŠ¡å™¨ï¼‰é…ç½®**ï¼š

```bash
# ç¼–è¾‘rsyslogé…ç½®æ–‡ä»¶
sudo nano /etc/rsyslog.conf

# æ·»åŠ è¿œç¨‹æ—¥å¿—ä¼ è¾“é…ç½®
# UDPæ–¹å¼ä¼ è¾“ï¼ˆé€Ÿåº¦å¿«ä½†å¯èƒ½ä¸¢å¤±ï¼‰
*.* @192.168.1.100:514

# TCPæ–¹å¼ä¼ è¾“ï¼ˆå¯é ä½†ç¨æ…¢ï¼‰  
*.* $$192.168.1.100:514

# åªä¼ è¾“ç‰¹å®šçº§åˆ«çš„æ—¥å¿—
*.error $$192.168.1.100:514
```

**é…ç½®è¯­æ³•è¯´æ˜**ï¼š
```bash
# @ è¡¨ç¤ºUDPä¼ è¾“
*.* @æœåŠ¡å™¨IP:ç«¯å£

# $$ è¡¨ç¤ºTCPä¼ è¾“  
*.* $$æœåŠ¡å™¨IP:ç«¯å£

# å¯ä»¥æŒ‡å®šç‰¹å®šçš„è®¾æ–½å’Œçº§åˆ«
mail.* $$192.168.1.100:514        # åªä¼ è¾“é‚®ä»¶æ—¥å¿—
*.error $$192.168.1.100:514       # åªä¼ è¾“é”™è¯¯çº§åˆ«ä»¥ä¸Šæ—¥å¿—
local0.* $$192.168.1.100:514      # åªä¼ è¾“local0è®¾æ–½æ—¥å¿—
```

### 5.3 æµ‹è¯•è¿œç¨‹æ—¥å¿—ä¼ è¾“


**é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ**ï¼š

```bash
# åœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éƒ½é‡å¯rsyslog
sudo systemctl restart rsyslog

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status rsyslog
```

**æµ‹è¯•è¿œç¨‹ä¼ è¾“**ï¼š

```bash
# åœ¨å®¢æˆ·ç«¯å‘é€æµ‹è¯•æ—¥å¿—
logger -p local0.info "Test remote logging from client"

# åœ¨æœåŠ¡å™¨ç«¯æŸ¥çœ‹æ˜¯å¦æ”¶åˆ°æ—¥å¿—
tail -f /var/log/messages | grep "Test remote logging"
```

**æ£€æŸ¥ç½‘ç»œè¿æ¥**ï¼š

```bash
# æ£€æŸ¥514ç«¯å£æ˜¯å¦å¼€æ”¾
sudo netstat -tuln | grep :514

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
telnet 192.168.1.100 514
```

> âš ï¸ **é˜²ç«å¢™æ³¨æ„äº‹é¡¹**ï¼š
> ç¡®ä¿é˜²ç«å¢™å…è®¸514ç«¯å£çš„é€šä¿¡ï¼Œå¦åˆ™æ—¥å¿—ä¼ è¾“ä¼šå¤±è´¥

### 5.4 è¿œç¨‹æ—¥å¿—å®‰å…¨é…ç½®


**é…ç½®TLSåŠ å¯†ä¼ è¾“**ï¼š

```bash
# åœ¨æœåŠ¡å™¨ç«¯é…ç½®TLS
sudo nano /etc/rsyslog.conf

# æ·»åŠ TLSé…ç½®
$DefaultNetstreamDriver gtls
$DefaultNetstreamDriverCAFile /etc/ssl/rsyslog/ca.pem
$DefaultNetstreamDriverCertFile /etc/ssl/rsyslog/server-cert.pem  
$DefaultNetstreamDriverKeyFile /etc/ssl/rsyslog/server-key.pem
$InputTCPServerStreamDriverMode 1
$InputTCPServerStreamDriverAuthMode anon
```

**é™åˆ¶è¿œç¨‹è®¿é—®**ï¼š

```bash
# åªå…è®¸ç‰¹å®šIPè®¿é—®æ—¥å¿—æœåŠ¡
# åœ¨/etc/hosts.allowä¸­æ·»åŠ ï¼š
rsyslogd: 192.168.1.0/24

# åœ¨/etc/hosts.denyä¸­æ·»åŠ ï¼š
rsyslogd: ALL
```

---

## 6. ğŸ’¾ æ—¥å¿—å­˜å‚¨ç©ºé—´ç®¡ç†


### 6.1 ç›‘æ§æ—¥å¿—ç©ºé—´ä½¿ç”¨æƒ…å†µ


**æ£€æŸ¥æ—¥å¿—ç›®å½•å ç”¨ç©ºé—´**ï¼š

```bash
# æŸ¥çœ‹/var/logç›®å½•æ€»ä½“å ç”¨
du -sh /var/log

# æŸ¥çœ‹å„ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°
du -sh /var/log/* | sort -hr

# æŸ¥çœ‹æœ€å¤§çš„å‡ ä¸ªæ–‡ä»¶
find /var/log -type f -exec du -h {} + | sort -hr | head -10
```

**å®æ—¶ç›‘æ§ç£ç›˜ç©ºé—´**ï¼š

```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h

# ç›‘æ§ç‰¹å®šç›®å½•çš„ç©ºé—´å˜åŒ–
watch -n 60 'df -h | grep -E "(Filesystem|/var/log)"'
```

### 6.2 é…ç½®æ—¥å¿—ç©ºé—´é™åˆ¶ç­–ç•¥


**ä¸ºjournaldé…ç½®ç©ºé—´é™åˆ¶**ï¼š

```bash
# ç¼–è¾‘journaldé…ç½®
sudo nano /etc/systemd/journald.conf

[Journal]
# é™åˆ¶ç³»ç»Ÿæ—¥å¿—æ€»å¤§å°
SystemMaxUse=500M       # æœ€å¤§ä½¿ç”¨500MBç£ç›˜ç©ºé—´
SystemKeepFree=1G       # è‡³å°‘ä¿ç•™1GBç©ºé—²ç©ºé—´
SystemMaxFileSize=10M   # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§10MB

# é™åˆ¶è¿è¡Œæ—¶æ—¥å¿—å¤§å°ï¼ˆå†…å­˜ä¸­ï¼‰
RuntimeMaxUse=100M      # æœ€å¤§ä½¿ç”¨100MBå†…å­˜
RuntimeKeepFree=100M    # è‡³å°‘ä¿ç•™100MBç©ºé—²å†…å­˜
RuntimeMaxFileSize=10M  # å•ä¸ªè¿è¡Œæ—¶æ–‡ä»¶æœ€å¤§10MB
```

**åº”ç”¨é…ç½®æ›´æ”¹**ï¼š

```bash
# é‡å¯journaldæœåŠ¡
sudo systemctl restart systemd-journald

# æŸ¥çœ‹å½“å‰journaldå­˜å‚¨ä½¿ç”¨æƒ…å†µ
journalctl --disk-usage
```

### 6.3 æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶


**æ‰‹åŠ¨æ¸…ç†ç³»ç»Ÿæ—¥å¿—**ï¼š

```bash
# æ¸…ç†è¶…è¿‡30å¤©çš„æ—¥å¿—
sudo journalctl --vacuum-time=30d

# æ¸…ç†è¶…è¿‡500MBçš„æ—¥å¿—
sudo journalctl --vacuum-size=500M

# æ¸…ç†åªä¿ç•™æœ€è¿‘çš„æ–‡ä»¶
sudo journalctl --vacuum-files=10
```

**æ¸…ç†ä¼ ç»Ÿæ—¥å¿—æ–‡ä»¶**ï¼š

```bash
# æ¸…ç†å‹ç¼©çš„æ—§æ—¥å¿—æ–‡ä»¶
sudo find /var/log -name "*.gz" -mtime +30 -delete

# æ¸…ç†ç‰¹å®šåº”ç”¨çš„æ—§æ—¥å¿—
sudo find /var/log -name "*.log.*" -mtime +7 -delete

# æ¸…ç†ç©ºçš„æ—¥å¿—æ–‡ä»¶
sudo find /var/log -empty -type f -delete
```

### 6.4 è‡ªåŠ¨åŒ–æ—¥å¿—ç©ºé—´ç®¡ç†


**åˆ›å»ºå®šæœŸæ¸…ç†è„šæœ¬**ï¼š

```bash
# åˆ›å»ºæ¸…ç†è„šæœ¬
sudo nano /usr/local/bin/cleanup-logs.sh
```

**è„šæœ¬å†…å®¹**ï¼š
```bash
#!/bin/bash
# æ—¥å¿—æ¸…ç†è„šæœ¬

# è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„
LOG_DIR="/var/log"
LOG_FILE="/var/log/cleanup.log"

# è®°å½•æ¸…ç†å¼€å§‹æ—¶é—´
echo "$(date): Starting log cleanup..." >> $LOG_FILE

# æ¸…ç†journaldæ—¥å¿—ï¼ˆä¿ç•™30å¤©ï¼‰
journalctl --vacuum-time=30d >> $LOG_FILE 2>&1

# æ¸…ç†å‹ç¼©æ—¥å¿—æ–‡ä»¶ï¼ˆè¶…è¿‡7å¤©ï¼‰
find $LOG_DIR -name "*.gz" -mtime +7 -delete

# æ¸…ç†è½®è½¬æ—¥å¿—æ–‡ä»¶ï¼ˆè¶…è¿‡14å¤©ï¼‰
find $LOG_DIR -name "*.log.*" -mtime +14 -delete

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
DISK_USAGE=$(df /var | tail -1 | awk '{print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 80 ]; then
    echo "$(date): WARNING - Disk usage is ${DISK_USAGE}%" >> $LOG_FILE
fi

echo "$(date): Log cleanup completed." >> $LOG_FILE
```

**è®¾ç½®å®šæ—¶æ‰§è¡Œ**ï¼š

```bash
# è®¾ç½®è„šæœ¬å¯æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/cleanup-logs.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œï¼‰
echo "0 2 * * * root /usr/local/bin/cleanup-logs.sh" | sudo tee -a /etc/crontab
```

---

## 7. ğŸ” ç³»ç»Ÿå®¡è®¡æ—¥å¿—é…ç½®


### 7.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿå®¡è®¡æ—¥å¿—


**å®¡è®¡æ—¥å¿—å°±åƒç›‘æ§æ‘„åƒå¤´**ï¼Œä¸“é—¨è®°å½•ç³»ç»Ÿçš„å®‰å…¨ç›¸å…³äº‹ä»¶ï¼š

```
æ™®é€šæ—¥å¿— vs å®¡è®¡æ—¥å¿—ï¼š
æ™®é€šæ—¥å¿— â†’ è®°å½•"å‘ç”Ÿäº†ä»€ä¹ˆ"        â†’ åƒæ–°é—»æŠ¥é“
å®¡è®¡æ—¥å¿— â†’ è®°å½•"è°åšäº†ä»€ä¹ˆ"        â†’ åƒå®‰å…¨ç›‘æ§

å®¡è®¡æ—¥å¿—è®°å½•å†…å®¹ï¼š
ğŸ‘¤ ç”¨æˆ·ç™»å½•/é€€å‡º
ğŸ”‘ å¯†ç ä¿®æ”¹
ğŸ“ æ–‡ä»¶è®¿é—®/ä¿®æ”¹/åˆ é™¤
âš™ï¸ ç³»ç»Ÿé…ç½®æ›´æ”¹
ğŸ” æƒé™å˜æ›´
ğŸ’» å‘½ä»¤æ‰§è¡Œ
```

### 7.2 auditdæœåŠ¡é…ç½®


**å®‰è£…å’Œå¯åŠ¨auditd**ï¼š

```bash
# åœ¨Ubuntu/Debianä¸Šå®‰è£…
sudo apt update
sudo apt install auditd audispd-plugins

# åœ¨CentOS/RHELä¸Šå®‰è£…
sudo yum install audit

# å¯åŠ¨å’Œå¯ç”¨auditdæœåŠ¡
sudo systemctl start auditd
sudo systemctl enable auditd

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status auditd
```

**é…ç½®auditdä¸»è¦å‚æ•°**ï¼š

```bash
# ç¼–è¾‘ä¸»é…ç½®æ–‡ä»¶
sudo nano /etc/audit/auditd.conf
```

**å…³é”®é…ç½®é€‰é¡¹**ï¼š
```bash
# æ—¥å¿—æ–‡ä»¶ä½ç½®
log_file = /var/log/audit/audit.log

# æ—¥å¿—æ–‡ä»¶å¤§å°é™åˆ¶
max_log_file = 50          # 50MB

# æ–‡ä»¶è½®è½¬è®¾ç½®
num_logs = 5               # ä¿ç•™5ä¸ªè½®è½¬æ–‡ä»¶
max_log_file_action = rotate   # è¾¾åˆ°å¤§å°é™åˆ¶æ—¶è½®è½¬

# ç£ç›˜ç©ºé—´ä¸è¶³æ—¶çš„åŠ¨ä½œ
space_left_action = syslog     # ç©ºé—´ä¸è¶³æ—¶å‘é€ç³»ç»Ÿæ—¥å¿—
admin_space_left_action = halt # ç©ºé—´ä¸¥é‡ä¸è¶³æ—¶åœæ­¢ç³»ç»Ÿ

# æ—¥å¿—æ ¼å¼
log_format = enriched      # ä½¿ç”¨å¢å¼ºæ ¼å¼
```

### 7.3 é…ç½®å®¡è®¡è§„åˆ™


**æŸ¥çœ‹å½“å‰å®¡è®¡è§„åˆ™**ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¡è®¡è§„åˆ™
sudo auditctl -l

# æŸ¥çœ‹å®¡è®¡çŠ¶æ€
sudo auditctl -s
```

**æ·»åŠ æ–‡ä»¶è®¿é—®ç›‘æ§è§„åˆ™**ï¼š

```bash
# ç›‘æ§/etc/passwdæ–‡ä»¶çš„æ‰€æœ‰è®¿é—®
sudo auditctl -w /etc/passwd -p rwxa -k passwd_changes

# ç›‘æ§/etc/shadowæ–‡ä»¶
sudo auditctl -w /etc/shadow -p rwxa -k shadow_changes

# ç›‘æ§é‡è¦é…ç½®ç›®å½•
sudo auditctl -w /etc/ssh/sshd_config -p rwxa -k ssh_config

# ç›‘æ§sudoé…ç½®æ–‡ä»¶
sudo auditctl -w /etc/sudoers -p rwxa -k sudo_changes
```

**è§„åˆ™å‚æ•°è¯´æ˜**ï¼š
```bash
-w path     # æŒ‡å®šè¦ç›‘æ§çš„è·¯å¾„
-p rwxa     # æŒ‡å®šç›‘æ§çš„æƒé™ï¼š
            # r: è¯»å– (read)
            # w: å†™å…¥ (write)  
            # x: æ‰§è¡Œ (execute)
            # a: å±æ€§å˜æ›´ (attribute change)
-k key      # è®¾ç½®è§„åˆ™çš„å…³é”®å­—ï¼ˆä¾¿äºæœç´¢ï¼‰
```

**æ·»åŠ ç³»ç»Ÿè°ƒç”¨ç›‘æ§è§„åˆ™**ï¼š

```bash
# ç›‘æ§ç”¨æˆ·åˆ›å»ºå’Œåˆ é™¤
sudo auditctl -a always,exit -F arch=b64 -S creat,unlink -k file_operations

# ç›‘æ§ç½‘ç»œè¿æ¥
sudo auditctl -a always,exit -F arch=b64 -S socket,connect -k network_ops

# ç›‘æ§è¿›ç¨‹æ‰§è¡Œ
sudo auditctl -a always,exit -F arch=b64 -S execve -k process_exec
```

### 7.4 æ°¸ä¹…ä¿å­˜å®¡è®¡è§„åˆ™


**å°†è§„åˆ™ä¿å­˜åˆ°é…ç½®æ–‡ä»¶**ï¼š

```bash
# ç¼–è¾‘å®¡è®¡è§„åˆ™æ–‡ä»¶
sudo nano /etc/audit/rules.d/audit.rules
```

**æ·»åŠ æ°¸ä¹…è§„åˆ™**ï¼š
```bash
# åˆ é™¤æ‰€æœ‰è§„åˆ™
-D

# è®¾ç½®å†…æ ¸å®¡è®¡å‚æ•°
-b 1024                    # è®¾ç½®å®¡è®¡ç¼“å†²åŒºå¤§å°
-f 1                       # å®¡è®¡å¤±è´¥æ—¶çš„è¡Œä¸ºï¼ˆ1=æ‰“å°æ¶ˆæ¯ï¼‰

# æ–‡ä»¶ç³»ç»Ÿç›‘æ§è§„åˆ™
-w /etc/passwd -p wa -k identity
-w /etc/group -p wa -k identity
-w /etc/shadow -p wa -k identity
-w /etc/sudoers -p wa -k sudoers

# ç™»å½•ç›‘æ§
-w /var/log/faillog -p wa -k logins
-w /var/log/lastlog -p wa -k logins

# ç½‘ç»œç¯å¢ƒå˜æ›´
-a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale

# æ—¶é—´å˜æ›´
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change

# ä½¿è§„åˆ™ä¸å¯å˜æ›´
-e 2
```

**é‡æ–°åŠ è½½è§„åˆ™**ï¼š

```bash
# é‡æ–°åŠ è½½å®¡è®¡è§„åˆ™
sudo augenrules --load

# é‡å¯auditdæœåŠ¡
sudo service auditd restart
```

---

## 8. ğŸ”§ æ—¥å¿—æ•…éšœæ’æŸ¥æ–¹æ³•


### 8.1 å¸¸è§æ—¥å¿—é—®é¢˜è¯Šæ–­


**æ—¥å¿—æœåŠ¡æ— æ³•å¯åŠ¨**ï¼š

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status rsyslog
sudo systemctl status systemd-journald

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
sudo journalctl -xe -u rsyslog
sudo journalctl -xe -u systemd-journald

# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
sudo rsyslogd -N1                # æ£€æŸ¥rsyslogé…ç½®è¯­æ³•
```

**æ—¥å¿—æ–‡ä»¶ä¸ç”Ÿæˆ**ï¼š

```bash
# æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
ls -ld /var/log
ls -la /var/log/messages

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /var

# æ£€æŸ¥selinuxçŠ¶æ€ï¼ˆå¦‚æœå¯ç”¨ï¼‰
getenforce
```

### 8.2 æ—¥å¿—è½®è½¬é—®é¢˜æ’æŸ¥


**è½®è½¬ä¸å·¥ä½œçš„è¯Šæ–­**ï¼š

```bash
# æ£€æŸ¥logrotateçŠ¶æ€
sudo cat /var/lib/logrotate/status

# æŸ¥çœ‹logrotateæœ€åæ‰§è¡Œæ—¶é—´
ls -la /var/lib/logrotate/

# æ‰‹åŠ¨æ‰§è¡Œå¹¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
sudo logrotate -d -v /etc/logrotate.conf

# æ£€æŸ¥cronä»»åŠ¡
sudo cat /etc/cron.daily/logrotate
```

**ä¿®å¤è½®è½¬æƒé™é—®é¢˜**ï¼š

```bash
# æ£€æŸ¥logrotateçŠ¶æ€æ–‡ä»¶æƒé™
sudo ls -la /var/lib/logrotate/status

# å¦‚æœæƒé™æœ‰é—®é¢˜ï¼Œä¿®å¤å®ƒ
sudo chmod 644 /var/lib/logrotate/status
sudo chown root:root /var/lib/logrotate/status
```

### 8.3 æ—¥å¿—å†…å®¹åˆ†ææŠ€å·§


**ä½¿ç”¨grepåˆ†ææ—¥å¿—**ï¼š

```bash
# æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯
grep -i error /var/log/messages

# æŸ¥æ‰¾ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
grep "Jan 15 10:" /var/log/messages

# æŸ¥æ‰¾ç”¨æˆ·ç™»å½•å¤±è´¥
grep "Failed password" /var/log/auth.log

# ç»Ÿè®¡é”™è¯¯é¢‘æ¬¡
grep -c "error" /var/log/messages
```

**ä½¿ç”¨awkåˆ†ææ—¥å¿—**ï¼š

```bash
# ç»Ÿè®¡æ¯å°æ—¶çš„æ—¥å¿—æ¡ç›®æ•°
awk '{print $3}' /var/log/messages | cut -d: -f1 | sort | uniq -c

# æå–ç‰¹å®šå­—æ®µä¿¡æ¯
awk '/sshd/ {print $1, $2, $3, $11}' /var/log/auth.log

# ç»Ÿè®¡IPåœ°å€è®¿é—®é¢‘æ¬¡
awk '/Failed password/ {print $11}' /var/log/auth.log | sort | uniq -c | sort -nr
```

**ä½¿ç”¨journalctlåˆ†æsystemdæ—¥å¿—**ï¼š

```bash
# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—
journalctl -u ssh.service

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
journalctl --since "2025-01-15 10:00:00" --until "2025-01-15 11:00:00"

# æŸ¥çœ‹æŒ‡å®šä¼˜å…ˆçº§çš„æ—¥å¿—
journalctl -p err

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
journalctl -f
```

### 8.4 æ—¥å¿—æ€§èƒ½ä¼˜åŒ–


**ä¼˜åŒ–rsyslogæ€§èƒ½**ï¼š

```bash
# ç¼–è¾‘rsyslogé…ç½®
sudo nano /etc/rsyslog.conf

# æ·»åŠ æ€§èƒ½ä¼˜åŒ–é…ç½®
$WorkDirectory /var/spool/rsyslog    # è®¾ç½®å·¥ä½œç›®å½•
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat    # ä½¿ç”¨ä¼ ç»Ÿæ ¼å¼
$ActionFileEnableSync off            # ç¦ç”¨åŒæ­¥å†™å…¥ï¼ˆæé«˜æ€§èƒ½ï¼‰
$MainMsgQueueSize 10000             # å¢åŠ æ¶ˆæ¯é˜Ÿåˆ—å¤§å°
```

**ä¼˜åŒ–journaldæ€§èƒ½**ï¼š

```bash
# ç¼–è¾‘journaldé…ç½®
sudo nano /etc/systemd/journald.conf

[Journal]
# æ€§èƒ½ç›¸å…³é…ç½®
SyncIntervalSec=30s      # åŒæ­¥é—´éš”30ç§’
RateLimitBurst=10000     # å¢åŠ çªå‘é™åˆ¶
RateLimitIntervalSec=30s # é™åˆ¶é—´éš”æ—¶é—´
Compress=yes             # å¯ç”¨å‹ç¼©
```

**ç›‘æ§æ—¥å¿—ç³»ç»Ÿæ€§èƒ½**ï¼š

```bash
# æŸ¥çœ‹journaldå†…å­˜ä½¿ç”¨
systemctl status systemd-journald

# æŸ¥çœ‹æ—¥å¿—å†™å…¥é€Ÿåº¦
iostat -x 1 | grep -E "(Device|sd)"

# ç›‘æ§æ—¥å¿—ç›®å½•IO
iotop -a -o -d 1
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ æ—¥å¿—æœåŠ¡ç±»å‹ï¼šrsyslogï¼ˆä¼ ç»Ÿï¼‰vs systemd-journaldï¼ˆç°ä»£ï¼‰
ğŸ”¸ æ ¸å¿ƒæ—¥å¿—ä½ç½®ï¼š/var/log/messagesã€auth.logã€kern.logç­‰
ğŸ”¸ æ—¥å¿—è½®è½¬å·¥å…·ï¼šlogrotateé…ç½®ä¸ä½¿ç”¨
ğŸ”¸ æ—¥å¿—çº§åˆ«ä½“ç³»ï¼šä»DEBUGåˆ°EMERGENCYçš„8ä¸ªçº§åˆ«
ğŸ”¸ è¿œç¨‹æ—¥å¿—ä¼ è¾“ï¼šåŸºäºUDP/TCPçš„é›†ä¸­å¼æ—¥å¿—ç®¡ç†
ğŸ”¸ å®¡è®¡æ—¥å¿—ç³»ç»Ÿï¼šauditdçš„å®‰å…¨ç›‘æ§åŠŸèƒ½
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ—¥å¿—æœåŠ¡çš„æœ¬è´¨ä½œç”¨**
```
ç³»ç»Ÿè®°å½•å‘˜ï¼š
- è®°å½•ç³»ç»Ÿæ‰€æœ‰é‡è¦äº‹ä»¶
- æä¾›æ•…éšœè¯Šæ–­ä¾æ®  
- æ”¯æŒå®‰å…¨å®¡è®¡éœ€æ±‚
- ååŠ©æ€§èƒ½åˆ†æä¼˜åŒ–
```

**ğŸ”¹ æ—¥å¿—è½®è½¬çš„é‡è¦æ€§**
```
ç©ºé—´ç®¡ç†ï¼š
- é˜²æ­¢æ—¥å¿—æ–‡ä»¶è¿‡å¤§å½±å“ç³»ç»Ÿæ€§èƒ½
- è‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—èŠ‚çœç£ç›˜ç©ºé—´
- ä¿æŒåˆé€‚çš„å†å²è®°å½•é•¿åº¦
- æ”¯æŒå‹ç¼©å’Œå½’æ¡£ç­–ç•¥
```

**ğŸ”¹ æ—¥å¿—çº§åˆ«çš„å®é™…æ„ä¹‰**
```
äº‹ä»¶åˆ†ç±»ï¼š
- EMERGENCY/ALERTï¼šéœ€è¦ç«‹å³äººå·¥å¹²é¢„
- CRITICAL/ERRORï¼šç³»ç»ŸåŠŸèƒ½å—åˆ°å½±å“
- WARNINGï¼šæ½œåœ¨é—®é¢˜ï¼Œéœ€è¦å…³æ³¨
- INFO/DEBUGï¼šæ­£å¸¸è¿è¡Œä¿¡æ¯
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ æ—¥å¸¸è¿ç»´åœºæ™¯**
- **æ•…éšœè¯Šæ–­**ï¼šé€šè¿‡æ—¥å¿—å¿«é€Ÿå®šä½ç³»ç»Ÿé—®é¢˜
- **å®‰å…¨ç›‘æ§**ï¼šç›‘æ§å¼‚å¸¸ç™»å½•å’Œæƒé™å˜æ›´
- **æ€§èƒ½åˆ†æ**ï¼šåˆ†æç³»ç»Ÿè´Ÿè½½å’Œèµ„æºä½¿ç”¨æƒ…å†µ
- **åˆè§„å®¡è®¡**ï¼šæ»¡è¶³å®‰å…¨åˆè§„è¦æ±‚çš„å®¡è®¡è®°å½•

**ğŸ”§ é…ç½®ç®¡ç†è¦ç‚¹**
- **æƒé™å®‰å…¨**ï¼šç¡®ä¿æ—¥å¿—æ–‡ä»¶æœ‰é€‚å½“çš„è®¿é—®æƒé™
- **ç©ºé—´æ§åˆ¶**ï¼šåˆç†é…ç½®è½®è½¬ç­–ç•¥é¿å…ç£ç›˜ç©ºé—´ä¸è¶³
- **é›†ä¸­ç®¡ç†**ï¼šåœ¨å¤šæœåŠ¡å™¨ç¯å¢ƒä¸­å®æ–½ç»Ÿä¸€æ—¥å¿—æ”¶é›†
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹åŸºäºæ—¥å¿—çš„è‡ªåŠ¨åŒ–ç›‘æ§æœºåˆ¶

### 9.4 å¸¸è§é—®é¢˜è§£å†³æ€è·¯


**ğŸ“ æ’æŸ¥æ­¥éª¤æ¨¡æ¿**
```
1. ç¡®è®¤æœåŠ¡çŠ¶æ€ï¼šsystemctl status <service>
2. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼šjournalctl -xe -u <service>  
3. æ£€æŸ¥é…ç½®è¯­æ³•ï¼šå·¥å…·ç‰¹å®šçš„è¯­æ³•æ£€æŸ¥å‘½ä»¤
4. éªŒè¯æ–‡ä»¶æƒé™ï¼šls -la ç›¸å…³æ–‡ä»¶å’Œç›®å½•
5. æµ‹è¯•åŠŸèƒ½æ­£å¸¸ï¼šæ‰‹åŠ¨æ‰§è¡Œæˆ–å‘é€æµ‹è¯•æ¶ˆæ¯
```

**ğŸ”§ ä¼˜åŒ–å»ºè®®**
```
æ€§èƒ½ä¼˜åŒ–ï¼š
- åˆç†è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œé¿å…è®°å½•è¿‡å¤šDEBUGä¿¡æ¯
- å¯ç”¨å‹ç¼©å’Œé€‚å½“çš„ç¼“å­˜æœºåˆ¶
- å°†é«˜é¢‘æ—¥å¿—å’Œç³»ç»Ÿåˆ†ç¦»å­˜å‚¨

å®‰å…¨åŠ å›ºï¼š
- é™åˆ¶æ—¥å¿—æ–‡ä»¶è®¿é—®æƒé™
- å¯ç”¨è¿œç¨‹æ—¥å¿—ä¼ è¾“çš„åŠ å¯†
- é…ç½®å®¡è®¡è§„åˆ™ç›‘æ§æ•æ„Ÿæ“ä½œ
- å®šæœŸå¤‡ä»½é‡è¦æ—¥å¿—æ–‡ä»¶
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ğŸ“š æ—¥å¿—æœåŠ¡è®°äº‹ä»¶ï¼Œè½®è½¬ç®¡ç†çœç©ºé—´
> ğŸ” çº§åˆ«åˆ†ç±»åŠ©è¯Šæ–­ï¼Œè¿œç¨‹æ”¶é›†ä¿å®‰å…¨  
> ğŸ›¡ï¸ å®¡è®¡ç›‘æ§é˜²é£é™©ï¼Œæƒé™é…ç½®è¦è§„èŒƒ
> ğŸ”§ æ•…éšœæ’æŸ¥çœ‹æ—¥å¿—ï¼Œä¼˜åŒ–æ€§èƒ½æä½“éªŒ

**å­¦ä¹ å»ºè®®**ï¼š
1. **åŠ¨æ‰‹å®è·µ**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­å°è¯•å„ç§é…ç½®
2. **æ—¥å¸¸è§‚å¯Ÿ**ï¼šç»å¸¸æŸ¥çœ‹æ—¥å¿—äº†è§£ç³»ç»Ÿæ­£å¸¸çŠ¶æ€
3. **æ•…éšœæ¼”ç»ƒ**ï¼šæ¨¡æ‹Ÿæ•…éšœåœºæ™¯ç»ƒä¹ æ—¥å¿—åˆ†æ
4. **æŒç»­å­¦ä¹ **ï¼šå…³æ³¨æ–°çš„æ—¥å¿—ç®¡ç†å·¥å…·å’Œæœ€ä½³å®è·µ