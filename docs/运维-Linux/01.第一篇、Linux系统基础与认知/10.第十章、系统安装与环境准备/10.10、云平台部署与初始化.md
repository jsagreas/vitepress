---
title: 10ã€äº‘å¹³å°éƒ¨ç½²ä¸åˆå§‹åŒ–
---
## ğŸ“š ç›®å½•

1. [äº‘å¹³å°éƒ¨ç½²æ¦‚è¿°](#1-äº‘å¹³å°éƒ¨ç½²æ¦‚è¿°)
2. [äº‘é•œåƒé€‰æ‹©ä¸é…ç½®](#2-äº‘é•œåƒé€‰æ‹©ä¸é…ç½®)
3. [å®ä¾‹ç±»å‹ä¸è§„æ ¼é€‰æ‹©](#3-å®ä¾‹ç±»å‹ä¸è§„æ ¼é€‰æ‹©)
4. [cloud-initåˆå§‹åŒ–è„šæœ¬](#4-cloud-initåˆå§‹åŒ–è„šæœ¬)
5. [å®‰å…¨ç»„ä¸ç½‘ç»œé…ç½®](#5-å®‰å…¨ç»„ä¸ç½‘ç»œé…ç½®)
6. [SSHå¯†é’¥å¯¹ç®¡ç†](#6-SSHå¯†é’¥å¯¹ç®¡ç†)
7. [ç”¨æˆ·æ•°æ®æ³¨å…¥é…ç½®](#7-ç”¨æˆ·æ•°æ®æ³¨å…¥é…ç½®)
8. [å­˜å‚¨å·æŒ‚è½½ä¸é…ç½®](#8-å­˜å‚¨å·æŒ‚è½½ä¸é…ç½®)
9. [ç›‘æ§ä¸æ—¥å¿—æ”¶é›†è®¾ç½®](#9-ç›‘æ§ä¸æ—¥å¿—æ”¶é›†è®¾ç½®)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. â˜ï¸ äº‘å¹³å°éƒ¨ç½²æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯äº‘å¹³å°éƒ¨ç½²


**ğŸ”¸ ç®€å•ç†è§£**
```
ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼ï¼š
â€¢ ä¹°æœåŠ¡å™¨ç¡¬ä»¶ â†’ å®‰è£…æ“ä½œç³»ç»Ÿ â†’ é…ç½®ç½‘ç»œ â†’ éƒ¨ç½²åº”ç”¨
â€¢ å‘¨æœŸé•¿ï¼Œæˆæœ¬é«˜ï¼Œç»´æŠ¤å¤æ‚

äº‘å¹³å°éƒ¨ç½²ï¼š
â€¢ é€‰æ‹©äº‘ä¸»æœº â†’ å‡ åˆ†é’Ÿåˆ›å»ºå®Œæˆ â†’ ç›´æ¥ä½¿ç”¨
â€¢ å¿«é€Ÿã€çµæ´»ã€æŒ‰éœ€ä»˜è´¹
```

**ğŸ’¡ äº‘éƒ¨ç½²çš„æ ¸å¿ƒä¼˜åŠ¿**
- **å¿«é€Ÿåˆ›å»º**ï¼šå‡ åˆ†é’Ÿå†…è·å¾—ä¸€å°æœåŠ¡å™¨
- **å¼¹æ€§æ‰©å±•**ï¼šæ ¹æ®éœ€è¦éšæ—¶å¢å‡æœåŠ¡å™¨
- **æˆæœ¬å¯æ§**ï¼šç”¨å¤šå°‘ä»˜å¤šå°‘ï¼Œæ— éœ€å¤§é‡åˆå§‹æŠ•èµ„
- **å…¨çƒéƒ¨ç½²**ï¼šåœ¨ä¸–ç•Œå„åœ°å¿«é€Ÿéƒ¨ç½²æœåŠ¡å™¨

### 1.2 ä¸»æµäº‘å¹³å°å¯¹æ¯”


| äº‘å¹³å° | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **é•œåƒç”Ÿæ€** |
|--------|---------|-------------|-------------|
| ğŸŸ¦ **é˜¿é‡Œäº‘** | `å›½å†…è®¿é—®å¿«ï¼Œæ–‡æ¡£ä¸°å¯Œ` | `å›½å†…ä¸šåŠ¡é¦–é€‰` | `ä¸°å¯Œçš„å›½äº§åŒ–é•œåƒ` |
| ğŸŸ¨ **è…¾è®¯äº‘** | `æ¸¸æˆã€ç¤¾äº¤åœºæ™¯ä¼˜åŒ–` | `æ¸¸æˆã€è§†é¢‘ä¸šåŠ¡` | `é’ˆå¯¹æ€§ä¼˜åŒ–é•œåƒ` |
| ğŸŸ§ **AWS** | `åŠŸèƒ½æœ€å…¨é¢ï¼Œå…¨çƒé¢†å…ˆ` | `å›½é™…ä¸šåŠ¡ï¼Œå¤§å‹ä¼ä¸š` | `æœ€ä¸°å¯Œçš„é•œåƒåº“` |
| ğŸŸª **Azure** | `ä¸å¾®è½¯ç”Ÿæ€é›†æˆå¥½` | `ä¼ä¸šçº§åº”ç”¨` | `Windowsç³»é•œåƒä¸°å¯Œ` |

### 1.3 äº‘éƒ¨ç½²åŸºæœ¬æµç¨‹


```
äº‘å¹³å°éƒ¨ç½²æµç¨‹ï¼š

ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©é•œåƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ubuntu 20.04   â”‚ â† æ“ä½œç³»ç»Ÿç‰ˆæœ¬
â”‚  CentOS 7       â”‚
â”‚  Windows Server â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒæ­¥ï¼šé€‰æ‹©å®ä¾‹è§„æ ¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1æ ¸2Gå†…å­˜     â”‚ â† è®¡ç®—èµ„æº
â”‚   2æ ¸4Gå†…å­˜     â”‚
â”‚   4æ ¸8Gå†…å­˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸‰æ­¥ï¼šç½‘ç»œé…ç½®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VPCç½‘ç»œ       â”‚ â† ç½‘ç»œç¯å¢ƒ
â”‚   å®‰å…¨ç»„è§„åˆ™    â”‚
â”‚   å…¬ç½‘IP        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬å››æ­¥ï¼šåˆå§‹åŒ–é…ç½®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SSHå¯†é’¥å¯¹      â”‚ â† å®‰å…¨è®¤è¯
â”‚  åˆå§‹åŒ–è„šæœ¬     â”‚
â”‚  ç”¨æˆ·æ•°æ®       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ–¼ï¸ äº‘é•œåƒé€‰æ‹©ä¸é…ç½®


### 2.1 ä»€ä¹ˆæ˜¯äº‘é•œåƒ


**ğŸ”¸ é€šä¿—ç†è§£**
```
äº‘é•œåƒ = æ“ä½œç³»ç»Ÿçš„"å®‰è£…å…‰ç›˜"

ä¼ ç»Ÿå®‰è£…ï¼šå…‰ç›˜ â†’ å®‰è£…ç³»ç»Ÿ â†’ é…ç½®è½¯ä»¶ (éœ€è¦1-2å°æ—¶)
äº‘é•œåƒï¼š  é€‰æ‹©é•œåƒ â†’ å‡ åˆ†é’Ÿå¯åŠ¨ â†’ ç›´æ¥ä½¿ç”¨

é•œåƒé‡Œå·²ç»åŒ…å«äº†ï¼š
âœ… æ“ä½œç³»ç»Ÿ
âœ… åŸºç¡€è½¯ä»¶åŒ…
âœ… é©±åŠ¨ç¨‹åº
âœ… å®‰å…¨è¡¥ä¸
```

### 2.2 é•œåƒç±»å‹è¯¦è§£


**ğŸ·ï¸ å®˜æ–¹æ ‡å‡†é•œåƒ**
```
ç‰¹ç‚¹ï¼š
â€¢ äº‘å¹³å°å®˜æ–¹æä¾›å’Œç»´æŠ¤
â€¢ å®‰å…¨æ€§å’Œç¨³å®šæ€§æœ€å¥½
â€¢ å®šæœŸæ›´æ–°å®‰å…¨è¡¥ä¸

å¸¸è§é€‰æ‹©ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ubuntu    â”‚   CentOS    â”‚   Debian    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 20.04 LTS   â”‚    7.9      â”‚     10      â”‚
â”‚ 22.04 LTS   â”‚    8.4      â”‚     11      â”‚
â”‚ æœ€æ–°ç‰ˆ      â”‚  Stream 9   â”‚     12      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ› ï¸ åº”ç”¨é•œåƒ**
```
é¢„è£…å¸¸ç”¨è½¯ä»¶çš„é•œåƒï¼š

Webå¼€å‘é•œåƒï¼š
â€¢ LAMP (Linux + Apache + MySQL + PHP)
â€¢ LNMP (Linux + Nginx + MySQL + PHP)
â€¢ Node.jsç¯å¢ƒ

æ•°æ®åº“é•œåƒï¼š
â€¢ MySQL
â€¢ PostgreSQL
â€¢ Redis

å®¹å™¨é•œåƒï¼š
â€¢ Dockeré¢„è£…ç‰ˆ
â€¢ KubernetesèŠ‚ç‚¹é•œåƒ
```

### 2.3 é•œåƒé€‰æ‹©å»ºè®®


**ğŸ’¡ æ–°æ‰‹æ¨èé€‰æ‹©**
```
ğŸ¥‡ é¦–é€‰ï¼šUbuntu 20.04 LTS
åŸå› ï¼š
â€¢ æ–‡æ¡£èµ„æ–™æœ€ä¸°å¯Œ
â€¢ ç¤¾åŒºæ”¯æŒæœ€å¥½
â€¢ è½¯ä»¶åŒ…æ›´æ–°åŠæ—¶
â€¢ é€‚åˆå­¦ä¹ å’Œå¼€å‘

ğŸ¥ˆ å¤‡é€‰ï¼šCentOS 7
åŸå› ï¼š
â€¢ ä¼ä¸šç¯å¢ƒå¸¸ç”¨
â€¢ ç¨³å®šæ€§æå¥½
â€¢ é€‚åˆç”Ÿäº§ç¯å¢ƒ
```

**âš ï¸ é•œåƒé€‰æ‹©æ³¨æ„äº‹é¡¹**
- **ç‰ˆæœ¬ç¨³å®šæ€§**ï¼šç”Ÿäº§ç¯å¢ƒé€‰æ‹©LTSé•¿æœŸæ”¯æŒç‰ˆæœ¬
- **è½¯ä»¶å…¼å®¹æ€§**ï¼šç¡®ä¿éœ€è¦çš„è½¯ä»¶åœ¨è¯¥ç³»ç»Ÿä¸Šå¯ç”¨
- **å®‰å…¨æ›´æ–°**ï¼šé€‰æ‹©ä»åœ¨ç»´æŠ¤æœŸå†…çš„ç‰ˆæœ¬
- **èµ„æºæ¶ˆè€—**ï¼šè½»é‡çº§ç³»ç»Ÿå‡å°‘èµ„æºå ç”¨

### 2.4 é•œåƒé…ç½®å®ä¾‹


**ğŸ”§ é˜¿é‡Œäº‘é•œåƒé€‰æ‹©ç¤ºä¾‹**
```bash
# æŸ¥çœ‹å¯ç”¨é•œåƒ
aliyun ecs DescribeImages --RegionId cn-hangzhou --ImageOwnerAlias system

# é€‰æ‹©Ubuntu 20.04é•œåƒ
ImageId: ubuntu_20_04_x64_20G_alibase_20210420.vhd

# é•œåƒåŸºæœ¬ä¿¡æ¯ï¼š
â€¢ æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04 LTS
â€¢ æ¶æ„ï¼šx86_64
â€¢ ç³»ç»Ÿç›˜ï¼š20GB
â€¢ é¢„è£…è½¯ä»¶ï¼šåŸºç¡€å¼€å‘å·¥å…·
```

---

## 3. âš™ï¸ å®ä¾‹ç±»å‹ä¸è§„æ ¼é€‰æ‹©


### 3.1 å®ä¾‹ç±»å‹åˆ†ç±»


**ğŸ”¸ ä»€ä¹ˆæ˜¯å®ä¾‹ç±»å‹**
```
å®ä¾‹ç±»å‹ = äº‘æœåŠ¡å™¨çš„"é…ç½®å¥—é¤"

å°±åƒä¹°æ‰‹æœºé€‰é…ç½®ï¼š
â€¢ å…¥é—¨ç‰ˆï¼šå¤Ÿç”¨å°±è¡Œ
â€¢ æ ‡å‡†ç‰ˆï¼šæ€§èƒ½å‡è¡¡
â€¢ é«˜é…ç‰ˆï¼šæ€§èƒ½å¼ºåŠ²
â€¢ æ——èˆ°ç‰ˆï¼šé¡¶çº§é…ç½®
```

### 3.2 é€šç”¨å‹å®ä¾‹


**ğŸ“Š é€‚ç”¨åœºæ™¯ä¸é…ç½®**
```
é€šç”¨å‹ - é€‚åˆå¤§å¤šæ•°åº”ç”¨åœºæ™¯

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è§„æ ¼åç§°   â”‚   CPU   â”‚  å†…å­˜   â”‚  é€‚ç”¨åœºæ™¯ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  t5.small    â”‚  1æ ¸    â”‚   2GB   â”‚  æµ‹è¯•å¼€å‘ â”‚
â”‚  t5.large    â”‚  2æ ¸    â”‚   4GB   â”‚  å°å‹ç½‘ç«™ â”‚
â”‚  t5.xlarge   â”‚  4æ ¸    â”‚   8GB   â”‚  ä¸­å‹åº”ç”¨ â”‚
â”‚  t5.2xlarge  â”‚  8æ ¸    â”‚  16GB   â”‚  å¤§å‹åº”ç”¨ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ é€‰æ‹©å»ºè®®ï¼š
â€¢ ä¸ªäººå­¦ä¹ ï¼š1æ ¸2Gè¶³å¤Ÿ
â€¢ å°å‹é¡¹ç›®ï¼š2æ ¸4Gåˆé€‚
â€¢ ç”Ÿäº§ç¯å¢ƒï¼š4æ ¸8Gèµ·æ­¥
```

### 3.3 ä¸“ç”¨å‹å®ä¾‹


**ğŸ¯ è®¡ç®—ä¼˜åŒ–å‹**
```
ç‰¹ç‚¹ï¼šCPUæ€§èƒ½å¼ºï¼ŒCPU:å†…å­˜æ¯”ä¾‹é«˜

é€‚ç”¨åœºæ™¯ï¼š
â€¢ WebæœåŠ¡å™¨
â€¢ ç§‘å­¦è®¡ç®—
â€¢ æ¸¸æˆæœåŠ¡å™¨
â€¢ é«˜æ€§èƒ½è®¡ç®—

é…ç½®ç¤ºä¾‹ï¼š
â€¢ c5.large: 2æ ¸4G (CPUå¯†é›†)
â€¢ c5.xlarge: 4æ ¸8G
```

**ğŸ—„ï¸ å†…å­˜ä¼˜åŒ–å‹**
```
ç‰¹ç‚¹ï¼šå†…å­˜å®¹é‡å¤§ï¼ŒCPU:å†…å­˜æ¯”ä¾‹ä½

é€‚ç”¨åœºæ™¯ï¼š
â€¢ æ•°æ®åº“æœåŠ¡å™¨
â€¢ ç¼“å­˜ç³»ç»Ÿ(Redis)
â€¢ å¤§æ•°æ®åˆ†æ
â€¢ å†…å­˜æ•°æ®åº“

é…ç½®ç¤ºä¾‹ï¼š
â€¢ r5.large: 2æ ¸16G (å†…å­˜å¯†é›†)
â€¢ r5.xlarge: 4æ ¸32G
```

**ğŸ’¾ å­˜å‚¨ä¼˜åŒ–å‹**
```
ç‰¹ç‚¹ï¼šæœ¬åœ°SSDå­˜å‚¨ï¼ŒI/Oæ€§èƒ½é«˜

é€‚ç”¨åœºæ™¯ï¼š
â€¢ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ
â€¢ æ•°æ®ä»“åº“
â€¢ é«˜I/Oæ•°æ®åº“
â€¢ æ—¥å¿—æ”¶é›†ç³»ç»Ÿ

é…ç½®ç¤ºä¾‹ï¼š
â€¢ i3.large: 2æ ¸15G + 475GB NVMe SSD
```

### 3.4 è§„æ ¼é€‰æ‹©ç­–ç•¥


**ğŸ“ˆ å®¹é‡è§„åˆ’åŸåˆ™**

```
æ€§èƒ½éœ€æ±‚è¯„ä¼°ï¼š

CPUä½¿ç”¨ç‡é¢„ä¼°ï¼š
â€¢ é™æ€ç½‘ç«™ï¼š    10-20%
â€¢ åŠ¨æ€Webåº”ç”¨ï¼š 30-50%  
â€¢ æ•°æ®åº“æœåŠ¡ï¼š  50-70%
â€¢ è®¡ç®—å¯†é›†åº”ç”¨ï¼š70-90%

å†…å­˜ä½¿ç”¨é¢„ä¼°ï¼š
â€¢ åŸºç¡€Linuxï¼š    512MB-1GB
â€¢ Webåº”ç”¨ï¼š      2-4GB
â€¢ æ•°æ®åº“ï¼š       4-8GB
â€¢ å¤§å‹åº”ç”¨ï¼š     8GBä»¥ä¸Š

å­˜å‚¨ç©ºé—´é¢„ä¼°ï¼š
â€¢ ç³»ç»Ÿç›˜ï¼š       20-40GB
â€¢ åº”ç”¨æ•°æ®ï¼š     æ ¹æ®ä¸šåŠ¡éœ€æ±‚
â€¢ æ—¥å¿—æ–‡ä»¶ï¼š     é¢„ç•™10-20%ç©ºé—´
```

**ğŸ’° æˆæœ¬ä¼˜åŒ–å»ºè®®**
```
ğŸ”¸ æŒ‰éœ€è®¡è´¹ç­–ç•¥
â€¢ å¼€å‘æµ‹è¯•ï¼šæŒ‰å°æ—¶è®¡è´¹ï¼Œéšç”¨éšå¼€
â€¢ ç¨³å®šä¸šåŠ¡ï¼šåŒ…æœˆè´­ä¹°ï¼Œäº«å—æŠ˜æ‰£
â€¢ é«˜å³°ä¸šåŠ¡ï¼šå¼¹æ€§ä¼¸ç¼©ï¼Œè‡ªåŠ¨è°ƒèŠ‚

ğŸ”¸ èµ„æºåˆ©ç”¨ä¼˜åŒ–
â€¢ ç›‘æ§èµ„æºä½¿ç”¨ç‡
â€¢ å®šæœŸè¯„ä¼°é…ç½®åˆç†æ€§
â€¢ åŠæ—¶è°ƒæ•´å®ä¾‹è§„æ ¼

ğŸ”¸ é¢„ç•™å®ä¾‹
â€¢ é•¿æœŸç¨³å®šä¸šåŠ¡è´­ä¹°é¢„ç•™å®ä¾‹
â€¢ å¯èŠ‚çœ30-50%æˆæœ¬
```

---

## 4. ğŸ”„ cloud-initåˆå§‹åŒ–è„šæœ¬


### 4.1 cloud-initæ˜¯ä»€ä¹ˆ


**ğŸ”¸ é€šä¿—è§£é‡Š**
```
cloud-init = äº‘æœåŠ¡å™¨çš„"å¼€æœºè‡ªåŠ¨åŒ–åŠ©æ‰‹"

æƒ³è±¡ä¸€ä¸‹ï¼š
ä½ ä¹°äº†ä¸€å°æ–°ç”µè„‘ï¼Œæ¯æ¬¡å¼€æœºéƒ½è¦ï¼š
â€¢ è®¾ç½®ç”¨æˆ·è´¦æˆ·
â€¢ å®‰è£…å¸¸ç”¨è½¯ä»¶
â€¢ é…ç½®ç½‘ç»œ
â€¢ è®¾ç½®å¼€æœºå¯åŠ¨é¡¹

cloud-initå°±æ˜¯å¸®ä½ è‡ªåŠ¨å®Œæˆè¿™äº›äº‹æƒ…çš„å·¥å…·ï¼
```

**ğŸ’¡ cloud-initçš„æ ¸å¿ƒä½œç”¨**
- **ç”¨æˆ·ç®¡ç†**ï¼šè‡ªåŠ¨åˆ›å»ºç”¨æˆ·ã€è®¾ç½®å¯†ç ã€é…ç½®SSHå¯†é’¥
- **ç½‘ç»œé…ç½®**ï¼šè‡ªåŠ¨é…ç½®IPã€DNSã€ä¸»æœºå
- **è½¯ä»¶å®‰è£…**ï¼šå¼€æœºè‡ªåŠ¨å®‰è£…å’Œæ›´æ–°è½¯ä»¶åŒ…
- **æ–‡ä»¶éƒ¨ç½²**ï¼šè‡ªåŠ¨ä¸‹è½½å’Œéƒ¨ç½²é…ç½®æ–‡ä»¶
- **å‘½ä»¤æ‰§è¡Œ**ï¼šå¼€æœºåè‡ªåŠ¨æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤

### 4.2 cloud-inité…ç½®æ ¼å¼


**ğŸ“ YAMLé…ç½®è¯­æ³•**
```yaml
#cloud-config

# ç”¨æˆ·é…ç½®
users:
  - name: myuser
    groups: sudo
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2E... user@example.com

# è½¯ä»¶åŒ…ç®¡ç†
packages:
  - nginx
  - mysql-server
  - git

# æ–‡ä»¶å†™å…¥
write_files:
  - path: /etc/nginx/nginx.conf
    content: |
      server {
          listen 80;
          server_name example.com;
      }
    permissions: '0644'

# è¿è¡Œå‘½ä»¤
runcmd:
  - systemctl enable nginx
  - systemctl start nginx
```

### 4.3 å¸¸ç”¨é…ç½®æ¨¡å—


**ğŸ‘¤ ç”¨æˆ·é…ç½®æ¨¡å—**
```yaml
#cloud-config
users:
  # åˆ›å»ºæ™®é€šç”¨æˆ·
  - name: webuser
    passwd: $6$rounds=4096$saltsalt$... # åŠ å¯†å¯†ç 
    groups: [sudo, www-data]
    shell: /bin/bash
    home: /home/webuser
    
  # è®¾ç½®rootç”¨æˆ·
  - name: root
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2E... admin@company.com

# ç¦ç”¨é»˜è®¤ç”¨æˆ·
disable_root: true
```

**ğŸ“¦ è½¯ä»¶åŒ…ç®¡ç†**
```yaml
#cloud-config

# æ›´æ–°åŒ…ç´¢å¼•
package_update: true

# å‡çº§å·²å®‰è£…åŒ…
package_upgrade: true

# å®‰è£…è½¯ä»¶åŒ…
packages:
  - curl
  - wget
  - htop
  - nginx
  - certbot

# é…ç½®è½¯ä»¶æº
apt:
  sources:
    docker:
      source: "deb https://download.docker.com/linux/ubuntu focal stable"
      key: |
        -----BEGIN PGP PUBLIC KEY BLOCK-----
        [Docker GPG key content]
        -----END PGP PUBLIC KEY BLOCK-----
```

**ğŸ“ æ–‡ä»¶æ“ä½œæ¨¡å—**
```yaml
#cloud-config

write_files:
  # åˆ›å»ºNginxé…ç½®
  - path: /etc/nginx/sites-available/mysite
    content: |
      server {
          listen 80;
          server_name mysite.com;
          root /var/www/html;
          index index.html;
      }
    owner: root:root
    permissions: '0644'
    
  # åˆ›å»ºç³»ç»ŸæœåŠ¡
  - path: /etc/systemd/system/myapp.service
    content: |
      [Unit]
      Description=My Application
      After=network.target
      
      [Service]
      Type=simple
      User=myuser
      ExecStart=/opt/myapp/start.sh
      
      [Install]
      WantedBy=multi-user.target
    permissions: '0644'
```

### 4.4 å®ç”¨åˆå§‹åŒ–è„šæœ¬ç¤ºä¾‹


**ğŸš€ WebæœåŠ¡å™¨å¿«é€Ÿéƒ¨ç½²**
```yaml
#cloud-config

# ç³»ç»Ÿæ›´æ–°å’Œè½¯ä»¶å®‰è£…
package_update: true
package_upgrade: true

packages:
  - nginx
  - certbot
  - python3-certbot-nginx
  - ufw

# åˆ›å»ºWebç”¨æˆ·
users:
  - name: webadmin
    groups: [sudo, www-data]
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3... webadmin@company.com

# éƒ¨ç½²ç½‘ç«™æ–‡ä»¶
write_files:
  - path: /var/www/html/index.html
    content: |
      <!DOCTYPE html>
      <html>
      <head><title>Welcome</title></head>
      <body>
        <h1>æœåŠ¡å™¨éƒ¨ç½²æˆåŠŸï¼</h1>
        <p>æ—¶é—´: $(date)</p>
      </body>
      </html>
    permissions: '0644'

# é…ç½®é˜²ç«å¢™å’Œå¯åŠ¨æœåŠ¡
runcmd:
  - ufw --force enable
  - ufw allow ssh
  - ufw allow 'Nginx Full'
  - systemctl enable nginx
  - systemctl start nginx
  - systemctl reload nginx
```

**ğŸ”’ å®‰å…¨åŠ å›ºè„šæœ¬**
```yaml
#cloud-config

# ç³»ç»Ÿå®‰å…¨é…ç½®
ssh_pwauth: false  # ç¦ç”¨å¯†ç ç™»å½•
disable_root: true # ç¦ç”¨rootç™»å½•

# åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
users:
  - name: admin
    groups: [sudo]
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3... admin@secure.com

# å®‰å…¨é…ç½®æ–‡ä»¶
write_files:
  # SSHå®‰å…¨é…ç½®
  - path: /etc/ssh/sshd_config.d/security.conf
    content: |
      Port 2222
      PermitRootLogin no
      PasswordAuthentication no
      PubkeyAuthentication yes
      MaxAuthTries 3
    permissions: '0644'
  
  # é˜²ç«å¢™è§„åˆ™
  - path: /etc/ufw/user.rules
    content: |
      # å…è®¸SSH (è‡ªå®šä¹‰ç«¯å£)
      -A ufw-user-input -p tcp --dport 2222 -j ACCEPT
      # å…è®¸HTTP/HTTPS
      -A ufw-user-input -p tcp --dport 80 -j ACCEPT
      -A ufw-user-input -p tcp --dport 443 -j ACCEPT

runcmd:
  # å¯ç”¨é˜²ç«å¢™
  - ufw --force enable
  - ufw default deny incoming
  - ufw default allow outgoing
  
  # é‡å¯SSHæœåŠ¡
  - systemctl restart sshd
  
  # å®‰è£…å®‰å…¨å·¥å…·
  - apt install -y fail2ban
  - systemctl enable fail2ban
  - systemctl start fail2ban
```

---

## 5. ğŸ›¡ï¸ å®‰å…¨ç»„ä¸ç½‘ç»œé…ç½®


### 5.1 ä»€ä¹ˆæ˜¯å®‰å…¨ç»„


**ğŸ”¸ å®‰å…¨ç»„çš„é€šä¿—ç†è§£**
```
å®‰å…¨ç»„ = äº‘æœåŠ¡å™¨çš„"é˜²ç«å¢™è§„åˆ™é›†"

å°±åƒå°åŒºçš„é—¨ç¦ç³»ç»Ÿï¼š
â€¢ å“ªäº›äººå¯ä»¥è¿›å…¥ï¼Ÿ     â†’ å…è®¸å“ªäº›IPè®¿é—®
â€¢ å¯ä»¥ä»å“ªäº›é—¨è¿›å…¥ï¼Ÿ   â†’ å¼€æ”¾å“ªäº›ç«¯å£  
â€¢ ä»€ä¹ˆæ—¶é—´å¯ä»¥è¿›å…¥ï¼Ÿ   â†’ è®¿é—®æ—¶é—´é™åˆ¶
â€¢ è¿›å…¥åèƒ½åšä»€ä¹ˆï¼Ÿ     â†’ åè®®ç±»å‹é™åˆ¶

å®‰å…¨ç»„å°±æ˜¯è¿™æ ·çš„"é—¨ç¦è§„åˆ™"
```

**ğŸšª å…¥ç«™è§„åˆ™ vs å‡ºç«™è§„åˆ™**
```
å…¥ç«™è§„åˆ™ (Inbound Rules)ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤–éƒ¨è®¿é—®   â”‚ â”€â”€â†’â”‚  äº‘æœåŠ¡å™¨   â”‚
â”‚  (Internet) â”‚    â”‚  (Your VM)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å¤–éƒ¨ â†’ æœåŠ¡å™¨ çš„è®¿é—®æ§åˆ¶

å‡ºç«™è§„åˆ™ (Outbound Rules)ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº‘æœåŠ¡å™¨   â”‚ â”€â”€â†’â”‚  å¤–éƒ¨æœåŠ¡   â”‚
â”‚  (Your VM)  â”‚    â”‚  (Internet) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æœåŠ¡å™¨ â†’ å¤–éƒ¨ çš„è®¿é—®æ§åˆ¶
```

### 5.2 å®‰å…¨ç»„è§„åˆ™é…ç½®


**ğŸ“‹ åŸºç¡€WebæœåŠ¡å™¨å®‰å…¨ç»„**
```
å…¥ç«™è§„åˆ™é…ç½®ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åè®®   â”‚ ç«¯å£ â”‚   æ¥æºIP   â”‚     è¯´æ˜        â”‚  ä¼˜å…ˆçº§ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SSH    â”‚  22  â”‚ 0.0.0.0/0  â”‚ SSHç®¡ç†è®¿é—®     â”‚   100   â”‚
â”‚  HTTP   â”‚  80  â”‚ 0.0.0.0/0  â”‚ ç½‘ç«™HTTPè®¿é—®    â”‚   110   â”‚
â”‚  HTTPS  â”‚ 443  â”‚ 0.0.0.0/0  â”‚ ç½‘ç«™HTTPSè®¿é—®   â”‚   120   â”‚
â”‚  TCP    â”‚ 3306 â”‚ 10.0.0.0/8 â”‚ å†…ç½‘æ•°æ®åº“è®¿é—®  â”‚   200   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‡ºç«™è§„åˆ™é…ç½®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åè®®   â”‚ ç«¯å£ â”‚  ç›®æ ‡IP    â”‚     è¯´æ˜        â”‚  ä¼˜å…ˆçº§ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ALL    â”‚ ALL  â”‚ 0.0.0.0/0  â”‚ å…è®¸æ‰€æœ‰å‡ºç«™    â”‚   100   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ” å®‰å…¨æœ€ä½³å®è·µé…ç½®**
```
é«˜å®‰å…¨æ€§é…ç½®å»ºè®®ï¼š

1. SSHè®¿é—®é™åˆ¶
åè®®: TCP
ç«¯å£: 2222 (éé»˜è®¤ç«¯å£)
æ¥æº: ä½ çš„å…¬å¸IPæ®µ (å¦‚: 203.0.113.0/24)
è¯´æ˜: åªå…è®¸ç‰¹å®šIPè®¿é—®SSH

2. WebæœåŠ¡è®¿é—®
åè®®: TCP
ç«¯å£: 80, 443
æ¥æº: 0.0.0.0/0 (å…¨ç½‘)
è¯´æ˜: ç½‘ç«™éœ€è¦å…¬ç½‘è®¿é—®

3. æ•°æ®åº“è®¿é—®
åè®®: TCP  
ç«¯å£: 3306
æ¥æº: å†…ç½‘IPæ®µ (å¦‚: 10.0.0.0/8)
è¯´æ˜: æ•°æ®åº“åªå…è®¸å†…ç½‘è®¿é—®

4. ç›‘æ§æœåŠ¡
åè®®: TCP
ç«¯å£: 9090
æ¥æº: ç®¡ç†å‘˜IP (å¦‚: 203.0.113.100/32)
è¯´æ˜: ç›‘æ§é¢æ¿åªå…è®¸ç®¡ç†å‘˜è®¿é—®
```

### 5.3 VPCç½‘ç»œé…ç½®


**ğŸŒ ä»€ä¹ˆæ˜¯VPC**
```
VPC (Virtual Private Cloud) = è™šæ‹Ÿç§æœ‰äº‘

ä¼ ç»Ÿç½‘ç»œæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å…¬ç½‘ç¯å¢ƒ                  â”‚
â”‚  [æœåŠ¡å™¨A] - [æœåŠ¡å™¨B] - [æœåŠ¡å™¨C] â”‚ 
â”‚     â†‘           â†‘           â†‘       â”‚
â”‚   æš´éœ²        æš´éœ²        æš´éœ²      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ‰€æœ‰æœåŠ¡å™¨éƒ½æš´éœ²åœ¨å…¬ç½‘ï¼Œå®‰å…¨é£é™©é«˜

VPCç½‘ç»œæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å…¬  ç½‘                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ç½‘å…³
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           VPCç§æœ‰ç½‘ç»œ               â”‚
â”‚  [WebæœåŠ¡å™¨] - [åº”ç”¨æœåŠ¡å™¨]         â”‚
â”‚       â”‚              â”‚              â”‚
â”‚  [æ•°æ®åº“æœåŠ¡å™¨] - [ç¼“å­˜æœåŠ¡å™¨]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å†…éƒ¨é€šä¿¡èµ°ç§ç½‘ï¼Œåªæœ‰å¿…è¦æœåŠ¡æš´éœ²å…¬ç½‘
```

**ğŸ—ï¸ VPCç½‘ç»œè§„åˆ’ç¤ºä¾‹**
```
VPCç½‘ç»œé…ç½®ï¼š

VPCç½‘æ®µ: 10.0.0.0/16 (å¯å®¹çº³65536ä¸ªIP)

å­ç½‘åˆ’åˆ†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å­ç½‘åç§°     â”‚   ç½‘æ®µ      â”‚   ç”¨é€”      â”‚   æœåŠ¡å™¨ç±»å‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ public-subnet  â”‚10.0.1.0/24  â”‚ å…¬ç½‘å­ç½‘    â”‚ WebæœåŠ¡å™¨   â”‚
â”‚ private-subnet â”‚10.0.2.0/24  â”‚ ç§ç½‘å­ç½‘    â”‚ åº”ç”¨æœåŠ¡å™¨  â”‚
â”‚ db-subnet      â”‚10.0.3.0/24  â”‚ æ•°æ®åº“å­ç½‘  â”‚ æ•°æ®åº“æœåŠ¡å™¨â”‚
â”‚ mgmt-subnet    â”‚10.0.4.0/24  â”‚ ç®¡ç†å­ç½‘    â”‚ è·³æ¿æœº/ç›‘æ§ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç½‘ç»œè®¿é—®è·¯å¾„ï¼š
Internet â†’ å…¬ç½‘å­ç½‘ â†’ ç§ç½‘å­ç½‘ â†’ æ•°æ®åº“å­ç½‘
         (Web)      (App)       (DB)
```

### 5.4 ç½‘ç»œé…ç½®å®è·µ


**âš™ï¸ é˜¿é‡Œäº‘VPCé…ç½®ç¤ºä¾‹**
```bash
# åˆ›å»ºVPC
aliyun ecs CreateVpc \
  --RegionId cn-hangzhou \
  --CidrBlock 10.0.0.0/16 \
  --VpcName MyWebApp-VPC

# åˆ›å»ºå…¬ç½‘å­ç½‘
aliyun ecs CreateVSwitch \
  --VpcId vpc-bp1234567890abcde \
  --CidrBlock 10.0.1.0/24 \
  --ZoneId cn-hangzhou-a \
  --VSwitchName public-subnet

# åˆ›å»ºç§ç½‘å­ç½‘  
aliyun ecs CreateVSwitch \
  --VpcId vpc-bp1234567890abcde \
  --CidrBlock 10.0.2.0/24 \
  --ZoneId cn-hangzhou-a \
  --VSwitchName private-subnet
```

**ğŸ”§ å®‰å…¨ç»„åˆ›å»ºä¸é…ç½®**
```bash
# åˆ›å»ºWebæœåŠ¡å™¨å®‰å…¨ç»„
aliyun ecs CreateSecurityGroup \
  --RegionId cn-hangzhou \
  --GroupName web-sg \
  --Description "WebæœåŠ¡å™¨å®‰å…¨ç»„"

# æ·»åŠ SSHè®¿é—®è§„åˆ™
aliyun ecs AuthorizeSecurityGroup \
  --SecurityGroupId sg-bp1234567890abcde \
  --IpProtocol tcp \
  --PortRange 22/22 \
  --SourceCidrIp 0.0.0.0/0

# æ·»åŠ HTTPè®¿é—®è§„åˆ™
aliyun ecs AuthorizeSecurityGroup \
  --SecurityGroupId sg-bp1234567890abcde \
  --IpProtocol tcp \
  --PortRange 80/80 \
  --SourceCidrIp 0.0.0.0/0

# æ·»åŠ HTTPSè®¿é—®è§„åˆ™
aliyun ecs AuthorizeSecurityGroup \
  --SecurityGroupId sg-bp1234567890abcde \
  --IpProtocol tcp \
  --PortRange 443/443 \
  --SourceCidrIp 0.0.0.0/0
```

---

## 6. ğŸ” SSHå¯†é’¥å¯¹ç®¡ç†


### 6.1 SSHå¯†é’¥å¯¹åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯SSHå¯†é’¥å¯¹**
```
SSHå¯†é’¥å¯¹ = æ•°å­—ä¸–ç•Œçš„"é—¨é”å’Œé’¥åŒ™"

ä¼ ç»Ÿå¯†ç ç™»å½•ï¼š
ç”¨æˆ·å + å¯†ç  = èº«ä»½éªŒè¯
é—®é¢˜ï¼šå¯†ç å¯èƒ½è¢«çŒœæµ‹ã€æ³„éœ²ã€æš´åŠ›ç ´è§£

SSHå¯†é’¥ç™»å½•ï¼š
ç§é’¥(ä½ ä¿ç®¡) + å…¬é’¥(æœåŠ¡å™¨ä¿ç®¡) = æ•°å­¦è¯æ˜èº«ä»½
ä¼˜åŠ¿ï¼šå‡ ä¹æ— æ³•è¢«ç ´è§£ï¼Œæ›´å®‰å…¨ä¾¿æ·
```

**ğŸ”‘ å…¬é’¥ç§é’¥å·¥ä½œåŸç†**
```
å¯†é’¥å¯¹ç”Ÿæˆè¿‡ç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç§é’¥æ–‡ä»¶  â”‚    â”‚   å…¬é’¥æ–‡ä»¶  â”‚
â”‚ (id_rsa)    â”‚    â”‚(id_rsa.pub) â”‚
â”‚  ä½ ä¿ç®¡     â”‚    â”‚ æ”¾åˆ°æœåŠ¡å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚
       â””â”€â”€â”€â”€â”€â”€ æ•°å­¦å…³è” â”€â”€â”€â”€â”€â”€â”˜

ç™»å½•éªŒè¯è¿‡ç¨‹ï¼š
1. å®¢æˆ·ç«¯å‘é€å…¬é’¥æ ‡è¯†
2. æœåŠ¡å™¨å‘é€éšæœºæ•°æ®
3. å®¢æˆ·ç«¯ç”¨ç§é’¥åŠ å¯†æ•°æ®
4. æœåŠ¡å™¨ç”¨å…¬é’¥éªŒè¯åŠ å¯†ç»“æœ
5. éªŒè¯æˆåŠŸï¼Œå…è®¸ç™»å½•
```

### 6.2 å¯†é’¥å¯¹ç”Ÿæˆä¸ç®¡ç†


**ğŸ› ï¸ ç”ŸæˆSSHå¯†é’¥å¯¹**
```bash
# ç”Ÿæˆæ–°çš„SSHå¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# äº¤äº’å¼é…ç½®
Generating public/private rsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): ********
Enter same passphrase again: ********

# ç”Ÿæˆç»“æœ
Your identification has been saved in /home/user/.ssh/id_rsa
Your public key has been saved in /home/user/.ssh/id_rsa.pub
```

**ğŸ“‚ å¯†é’¥æ–‡ä»¶ç»“æ„**
```
~/.ssh/ ç›®å½•ç»“æ„ï¼š
â”œâ”€â”€ id_rsa          # ç§é’¥æ–‡ä»¶ (600æƒé™ï¼Œä¸¥æ ¼ä¿å¯†)
â”œâ”€â”€ id_rsa.pub      # å…¬é’¥æ–‡ä»¶ (644æƒé™ï¼Œå¯ä»¥åˆ†äº«)
â”œâ”€â”€ authorized_keys # æˆæƒçš„å…¬é’¥åˆ—è¡¨
â”œâ”€â”€ known_hosts     # å·²çŸ¥ä¸»æœºæŒ‡çº¹
â””â”€â”€ config          # SSHå®¢æˆ·ç«¯é…ç½®
```

**ğŸ” ä¸åŒåŠ å¯†ç®—æ³•å¯¹æ¯”**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç®—æ³•ç±»å‹â”‚  å¯†é’¥é•¿åº¦â”‚   å®‰å…¨æ€§    â”‚   æ€§èƒ½      â”‚   å…¼å®¹æ€§    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RSA    â”‚  4096   â”‚    å¾ˆé«˜     â”‚    ä¸­ç­‰     â”‚   æœ€å¥½      â”‚
â”‚  Ed25519â”‚   256   â”‚    æœ€é«˜     â”‚    æœ€å¿«     â”‚   è¾ƒå¥½      â”‚
â”‚  ECDSA  â”‚   256   â”‚    å¾ˆé«˜     â”‚    å¿«       â”‚   å¥½        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¨èé€‰æ‹©ï¼š
â€¢ é€šç”¨ç¯å¢ƒï¼šRSA 4096ä½
â€¢ æ€§èƒ½ä¼˜å…ˆï¼šEd25519
â€¢ ä¼ä¸šç¯å¢ƒï¼šæ ¹æ®å®‰å…¨ç­–ç•¥é€‰æ‹©
```

### 6.3 äº‘å¹³å°å¯†é’¥ç®¡ç†


**â˜ï¸ äº‘å¹³å°å¯†é’¥å¯¹åˆ›å»º**
```bash
# é˜¿é‡Œäº‘åˆ›å»ºå¯†é’¥å¯¹
aliyun ecs CreateKeyPair \
  --RegionId cn-hangzhou \
  --KeyPairName my-keypair

# è¿”å›ç»“æœåŒ…å«ç§é’¥å†…å®¹ï¼Œéœ€è¦ä¿å­˜åˆ°æœ¬åœ°
{
  "KeyPairName": "my-keypair",
  "KeyPairFingerPrint": "89:f0:ba:62:ac:b8:aa:e1:61:5e:fd:81:69:86:6d:6b",
  "PrivateKeyBody": "-----BEGIN RSA PRIVATE KEY-----\n..."
}

# ä¿å­˜ç§é’¥åˆ°æœ¬åœ°æ–‡ä»¶
echo "-----BEGIN RSA PRIVATE KEY-----..." > ~/.ssh/my-keypair.pem
chmod 600 ~/.ssh/my-keypair.pem
```

**ğŸ”„ å¯¼å…¥ç°æœ‰å…¬é’¥**
```bash
# å°†æœ¬åœ°ç”Ÿæˆçš„å…¬é’¥å¯¼å…¥äº‘å¹³å°
aliyun ecs ImportKeyPair \
  --RegionId cn-hangzhou \
  --KeyPairName imported-keypair \
  --PublicKeyBody "$(cat ~/.ssh/id_rsa.pub)"

# æˆ–è€…é€šè¿‡Webæ§åˆ¶å°æ“ä½œï¼š
# 1. ç™»å½•äº‘æ§åˆ¶å°
# 2. è¿›å…¥ECS â†’ å¯†é’¥å¯¹ç®¡ç†
# 3. åˆ›å»º/å¯¼å…¥å¯†é’¥å¯¹
# 4. ç²˜è´´å…¬é’¥å†…å®¹
```

### 6.4 SSHå®¢æˆ·ç«¯é…ç½®


**ğŸ“ SSHé…ç½®æ–‡ä»¶ä¼˜åŒ–**
```bash
# ç¼–è¾‘SSHé…ç½®æ–‡ä»¶
vim ~/.ssh/config

# æ·»åŠ æœåŠ¡å™¨è¿æ¥é…ç½®
Host myserver
    HostName 47.98.123.45
    User admin
    Port 22
    IdentityFile ~/.ssh/my-keypair.pem
    IdentitiesOnly yes
    ServerAliveInterval 60
    ServerAliveCountMax 3

Host webserver
    HostName web.example.com
    User webadmin  
    IdentityFile ~/.ssh/id_rsa
    ProxyJump jumphost

# è·³æ¿æœºé…ç½®
Host jumphost
    HostName jump.example.com
    User jumpuser
    IdentityFile ~/.ssh/jump-key.pem
```

**ğŸš€ ä¾¿æ·è¿æ¥å‘½ä»¤**
```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶è¿æ¥ (æ¨è)
ssh myserver

# ç›´æ¥æŒ‡å®šå¯†é’¥è¿æ¥
ssh -i ~/.ssh/my-keypair.pem admin@47.98.123.45

# é€šè¿‡è·³æ¿æœºè¿æ¥
ssh -J jumphost webserver

# å¸¦ç«¯å£å·è¿æ¥
ssh -p 2222 admin@47.98.123.45

# å¼€å¯è¯¦ç»†æ—¥å¿—è°ƒè¯•
ssh -v myserver
```

**ğŸ”’ SSHå®‰å…¨é…ç½®**
```bash
# æœåŠ¡å™¨ç«¯SSHå®‰å…¨é…ç½®
sudo vim /etc/ssh/sshd_config

# æ¨èå®‰å…¨é…ç½®
Port 2222                          # ä¿®æ”¹é»˜è®¤ç«¯å£
PermitRootLogin no                 # ç¦æ­¢rootç›´æ¥ç™»å½•
PasswordAuthentication no          # ç¦ç”¨å¯†ç è®¤è¯
PubkeyAuthentication yes           # å¯ç”¨å…¬é’¥è®¤è¯
AuthorizedKeysFile .ssh/authorized_keys
MaxAuthTries 3                     # æœ€å¤§è®¤è¯å°è¯•æ¬¡æ•°
LoginGraceTime 60                  # ç™»å½•å®½é™æ—¶é—´
ClientAliveInterval 300            # å®¢æˆ·ç«¯å­˜æ´»æ£€æµ‹é—´éš”
ClientAliveCountMax 2              # æœ€å¤§å­˜æ´»æ£€æµ‹æ¬¡æ•°

# é‡å¯SSHæœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
sudo systemctl restart sshd
```

---

## 7. ğŸ“‹ ç”¨æˆ·æ•°æ®æ³¨å…¥é…ç½®


### 7.1 ç”¨æˆ·æ•°æ®æ³¨å…¥æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç”¨æˆ·æ•°æ®æ³¨å…¥**
```
ç”¨æˆ·æ•°æ®æ³¨å…¥ = åœ¨æœåŠ¡å™¨åˆ›å»ºæ—¶"æ¤å…¥"ä½ çš„è‡ªå®šä¹‰é…ç½®

ä¼ ç»Ÿæ–¹å¼ï¼š
åˆ›å»ºæœåŠ¡å™¨ â†’ æ‰‹åŠ¨ç™»å½• â†’ é€ä¸ªé…ç½® â†’ å®‰è£…è½¯ä»¶ â†’ éƒ¨ç½²åº”ç”¨

ç”¨æˆ·æ•°æ®æ³¨å…¥ï¼š
åˆ›å»ºæœåŠ¡å™¨æ—¶ç›´æ¥å†™å…¥é…ç½®è„šæœ¬ â†’ å¼€æœºè‡ªåŠ¨æ‰§è¡Œ â†’ ç›´æ¥å¯ç”¨

å°±åƒä¹°æ–°æ‰‹æœºæ—¶å¯ä»¥"ä¸€é”®æ¢å¤"ä¹‹å‰çš„è®¾ç½®å’Œåº”ç”¨
```

**ğŸ’¡ ç”¨æˆ·æ•°æ®çš„æ‰§è¡Œæ—¶æœº**
```
æœåŠ¡å™¨å¯åŠ¨æµç¨‹ï¼š

ç¬¬1æ­¥ï¼šç¡¬ä»¶åˆå§‹åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è™šæ‹ŸåŒ–å¹³å°    â”‚
â”‚   åˆ†é…èµ„æº      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬2æ­¥ï¼šæ“ä½œç³»ç»Ÿå¯åŠ¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åŠ è½½é•œåƒ      â”‚
â”‚   å¯åŠ¨å†…æ ¸      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬3æ­¥ï¼šcloud-initæ‰§è¡Œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¯»å–ç”¨æˆ·æ•°æ®  â”‚ â† è¿™é‡Œæ‰§è¡Œä½ çš„é…ç½®
â”‚   æ‰§è¡Œåˆå§‹åŒ–    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬4æ­¥ï¼šç³»ç»Ÿå°±ç»ª
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœåŠ¡å¯åŠ¨å®Œæˆ  â”‚
â”‚   å¯ä»¥æ­£å¸¸ä½¿ç”¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç”¨æˆ·æ•°æ®æ ¼å¼ç±»å‹


**ğŸ“œ Shellè„šæœ¬æ ¼å¼**
```bash
#!/bin/bash
# ç”¨æˆ·æ•°æ®ä»¥ #!/bin/bash å¼€å¤´

# ç³»ç»Ÿæ›´æ–°
apt update && apt upgrade -y

# å®‰è£…è½¯ä»¶
apt install -y nginx mysql-server git

# å¯åŠ¨æœåŠ¡
systemctl enable nginx
systemctl start nginx

# åˆ›å»ºç”¨æˆ·
useradd -m -s /bin/bash appuser
usermod -aG sudo appuser

# ä¸‹è½½åº”ç”¨ä»£ç 
cd /opt
git clone https://github.com/mycompany/myapp.git
chown -R appuser:appuser /opt/myapp

echo "æœåŠ¡å™¨åˆå§‹åŒ–å®Œæˆï¼"
```

**ğŸ“‹ Cloud-Configæ ¼å¼**
```yaml
#cloud-config

# è½¯ä»¶åŒ…å®‰è£…
packages:
  - nginx
  - mysql-server
  - git
  - htop

# ç”¨æˆ·åˆ›å»º
users:
  - name: appuser
    groups: [sudo]
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3... appuser@company.com

# æ–‡ä»¶å†™å…¥
write_files:
  - path: /opt/app/config.yaml
    content: |
      database:
        host: localhost
        port: 3306
        name: myapp
      server:
        port: 8080
    owner: appuser:appuser
    permissions: '0644'

# å‘½ä»¤æ‰§è¡Œ
runcmd:
  - systemctl enable nginx
  - systemctl start nginx
  - mysql -e "CREATE DATABASE myapp;"
```

**ğŸ”€ æ··åˆæ ¼å¼**
```bash
#!/bin/bash

# Shellè„šæœ¬éƒ¨åˆ†
apt update -y

# åµŒå…¥Cloud-Config
cat << 'EOF' > /tmp/cloud-config.yaml
#cloud-config
packages:
  - docker.io
  - docker-compose

runcmd:
  - systemctl enable docker
  - systemctl start docker
  - usermod -aG docker ubuntu
EOF

# æ‰§è¡ŒCloud-Config
cloud-init single --name cc_write_files --file /tmp/cloud-config.yaml
```

### 7.3 å®ç”¨é…ç½®æ¨¡æ¿


**ğŸŒ Webåº”ç”¨æœåŠ¡å™¨æ¨¡æ¿**
```bash
#!/bin/bash

# è®°å½•æ‰§è¡Œæ—¥å¿—
exec > >(tee /var/log/user-data.log)
exec 2>&1

echo "=== å¼€å§‹ç”¨æˆ·æ•°æ®åˆå§‹åŒ– $(date) ==="

# ç³»ç»Ÿæ›´æ–°
apt update && apt upgrade -y

# å®‰è£…å¿…è¦è½¯ä»¶
apt install -y nginx mysql-server php-fpm php-mysql certbot python3-certbot-nginx

# é…ç½®é˜²ç«å¢™
ufw allow ssh
ufw allow 'Nginx Full'
ufw --force enable

# åˆ›å»ºåº”ç”¨ç›®å½•
mkdir -p /var/www/myapp
chown -R www-data:www-data /var/www/myapp

# ä¸‹è½½åº”ç”¨ä»£ç 
cd /var/www/myapp
git clone https://github.com/mycompany/webapp.git .
composer install --no-dev --optimize-autoloader

# Nginxé…ç½®
cat > /etc/nginx/sites-available/myapp << 'EOF'
server {
    listen 80;
    server_name example.com www.example.com;
    root /var/www/myapp/public;
    index index.php index.html;
    
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
EOF

# å¯ç”¨ç«™ç‚¹
ln -s /etc/nginx/sites-available/myapp /etc/nginx/sites-enabled/
nginx -t && systemctl reload nginx

# æ•°æ®åº“é…ç½®
mysql -e "CREATE DATABASE myapp;"
mysql -e "CREATE USER 'appuser'@'localhost' IDENTIFIED BY 'secure_password';"
mysql -e "GRANT ALL ON myapp.* TO 'appuser'@'localhost';"

# å¯åŠ¨æœåŠ¡
systemctl enable nginx mysql php7.4-fpm
systemctl start nginx mysql php7.4-fpm

echo "=== ç”¨æˆ·æ•°æ®åˆå§‹åŒ–å®Œæˆ $(date) ==="
```

**ğŸ³ Dockerå®¹å™¨åŒ–ç¯å¢ƒæ¨¡æ¿**
```bash
#!/bin/bash

# å®‰è£…Docker
apt update
apt install -y apt-transport-https ca-certificates curl gnupg lsb-release

# æ·»åŠ Dockerå®˜æ–¹GPGå¯†é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# æ·»åŠ Dockeræº
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null

# å®‰è£…Docker Engine
apt update
apt install -y docker-ce docker-ce-cli containerd.io docker-compose

# å¯åŠ¨DockeræœåŠ¡
systemctl enable docker
systemctl start docker

# å°†ubuntuç”¨æˆ·æ·»åŠ åˆ°dockerç»„
usermod -aG docker ubuntu

# åˆ›å»ºåº”ç”¨ç›®å½•
mkdir -p /opt/myapp
cd /opt/myapp

# åˆ›å»ºdocker-compose.yml
cat > docker-compose.yml << 'EOF'
version: '3.8'
services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./html:/usr/share/nginx/html
  
  app:
    image: php:7.4-fpm
    volumes:
      - ./app:/var/www/html
  
  db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: myapp
      MYSQL_USER: appuser
      MYSQL_PASSWORD: apppassword
    volumes:
      - db_data:/var/lib/mysql

volumes:
  db_data:
EOF

# åˆ›å»ºç¤ºä¾‹ç½‘é¡µ
mkdir -p html
echo "<h1>Dockerç¯å¢ƒéƒ¨ç½²æˆåŠŸï¼</h1>" > html/index.html

# å¯åŠ¨å®¹å™¨
docker-compose up -d

echo "Dockerç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼"
```

### 7.4 ç”¨æˆ·æ•°æ®è°ƒè¯•æŠ€å·§


**ğŸ” è°ƒè¯•å’Œæ—¥å¿—æŸ¥çœ‹**
```bash
# æŸ¥çœ‹cloud-initæ‰§è¡Œæ—¥å¿—
sudo tail -f /var/log/cloud-init-output.log

# æŸ¥çœ‹è¯¦ç»†çš„cloud-initæ—¥å¿—
sudo tail -f /var/log/cloud-init.log

# æŸ¥çœ‹ç”¨æˆ·æ•°æ®è„šæœ¬æ‰§è¡Œç»“æœ
sudo cat /var/log/cloud-init-output.log | grep -A 10 -B 10 "error\|failed"

# æ‰‹åŠ¨é‡æ–°æ‰§è¡Œcloud-init (æµ‹è¯•ç”¨)
sudo cloud-init clean
sudo cloud-init init
```

**âš ï¸ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**
```bash
# é—®é¢˜1ï¼šè„šæœ¬æ‰§è¡Œå¤±è´¥
è§£å†³ï¼šåœ¨è„šæœ¬å¼€å¤´æ·»åŠ è°ƒè¯•ä¿¡æ¯
#!/bin/bash
set -x  # æ˜¾ç¤ºæ‰§è¡Œçš„æ¯ä¸ªå‘½ä»¤
exec > /tmp/user-data.log 2>&1  # é‡å®šå‘æ‰€æœ‰è¾“å‡ºåˆ°æ—¥å¿—

# é—®é¢˜2ï¼šè½¯ä»¶å®‰è£…å¤±è´¥  
è§£å†³ï¼šæ·»åŠ é‡è¯•æœºåˆ¶
for i in {1..3}; do
    apt update && break
    sleep 10
done

# é—®é¢˜3ï¼šç½‘ç»œè¿æ¥é—®é¢˜
è§£å†³ï¼šæ·»åŠ ç½‘ç»œæ£€æµ‹
while ! ping -c 1 8.8.8.8; do
    echo "ç­‰å¾…ç½‘ç»œè¿æ¥..."
    sleep 5
done

# é—®é¢˜4ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥
è§£å†³ï¼šæ·»åŠ å¯åŠ¨æ£€æŸ¥
systemctl start nginx
if ! systemctl is-active --quiet nginx; then
    echo "Nginxå¯åŠ¨å¤±è´¥ï¼" >&2
    systemctl status nginx >&2
fi
```

---

## 8. ğŸ’¾ å­˜å‚¨å·æŒ‚è½½ä¸é…ç½®


### 8.1 äº‘å­˜å‚¨ç±»å‹ç†è§£


**ğŸ”¸ äº‘å­˜å‚¨çš„é€šä¿—ç†è§£**
```
äº‘å­˜å‚¨ = äº‘æœåŠ¡å™¨çš„"ç¡¬ç›˜ç©ºé—´"

å°±åƒç”µè„‘çš„ç¡¬ç›˜ï¼š
â€¢ ç³»ç»Ÿç›˜ï¼šè£…æ“ä½œç³»ç»Ÿï¼ŒåƒCç›˜
â€¢ æ•°æ®ç›˜ï¼šå­˜åº”ç”¨æ•°æ®ï¼ŒåƒDç›˜ã€Eç›˜
â€¢ ç½‘ç»œç›˜ï¼šå…±äº«å­˜å‚¨ï¼Œåƒç½‘ç»œé©±åŠ¨å™¨

äº‘å­˜å‚¨çš„ä¼˜åŠ¿ï¼š
âœ… å¯ä»¥éšæ—¶æ‰©å®¹
âœ… æ•°æ®ç‹¬ç«‹äºæœåŠ¡å™¨
âœ… å¯ä»¥åœ¨æœåŠ¡å™¨é—´è¿ç§»  
âœ… æœ‰å¤‡ä»½å’Œå¿«ç…§åŠŸèƒ½
```

**ğŸ“Š å­˜å‚¨ç±»å‹å¯¹æ¯”**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å­˜å‚¨ç±»å‹  â”‚    æ€§èƒ½     â”‚    ä»·æ ¼     â”‚   é€‚ç”¨åœºæ™¯  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç³»ç»Ÿç›˜    â”‚    ä¸­ç­‰     â”‚    ä¸­ç­‰     â”‚  æ“ä½œç³»ç»Ÿ   â”‚
â”‚   é«˜æ€§èƒ½ç›˜  â”‚    å¾ˆé«˜     â”‚    è¾ƒé«˜     â”‚  æ•°æ®åº“     â”‚
â”‚   æ™®é€šç›˜    â”‚    ä¸€èˆ¬     â”‚    ä¾¿å®œ     â”‚  æ—¥å¿—æ–‡ä»¶   â”‚
â”‚   å¯¹è±¡å­˜å‚¨  â”‚    ä½       â”‚    å¾ˆä¾¿å®œ   â”‚  å¤‡ä»½å½’æ¡£   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IOPSæ€§èƒ½å‚è€ƒï¼š
â€¢ é«˜æ€§èƒ½SSDï¼š20,000+ IOPS
â€¢ æ™®é€šSSDï¼š   1,000-3,000 IOPS  
â€¢ æœºæ¢°ç¡¬ç›˜ï¼š   100-200 IOPS
```

### 8.2 å­˜å‚¨å·åˆ›å»ºå’ŒæŒ‚è½½


**ğŸ”§ åˆ›å»ºå’ŒæŒ‚è½½æ•°æ®ç›˜**
```bash
# 1. æŸ¥çœ‹ç°æœ‰ç£ç›˜
lsblk
NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
vda       8:0    0   40G  0 disk 
â””â”€vda1    8:1    0   40G  0 part /
vdb       8:16   0  100G  0 disk    # æ–°æ·»åŠ çš„æ•°æ®ç›˜

# 2. å¯¹æ–°ç£ç›˜åˆ†åŒº
sudo fdisk /dev/vdb

# fdiskäº¤äº’æ“ä½œï¼š
# n (åˆ›å»ºæ–°åˆ†åŒº)
# p (ä¸»åˆ†åŒº)  
# 1 (åˆ†åŒºå·)
# å›è½¦ (èµ·å§‹æ‰‡åŒºé»˜è®¤)
# å›è½¦ (ç»“æŸæ‰‡åŒºé»˜è®¤ï¼Œä½¿ç”¨å…¨éƒ¨ç©ºé—´)
# w (å†™å…¥åˆ†åŒºè¡¨)

# 3. æ ¼å¼åŒ–åˆ†åŒº
sudo mkfs.ext4 /dev/vdb1

# 4. åˆ›å»ºæŒ‚è½½ç‚¹
sudo mkdir /data

# 5. ä¸´æ—¶æŒ‚è½½
sudo mount /dev/vdb1 /data

# 6. éªŒè¯æŒ‚è½½
df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/vda1        40G  2.1G   36G   6% /
/dev/vdb1        99G   60M   94G   1% /data
```

**ğŸ“ æ°¸ä¹…æŒ‚è½½é…ç½®**
```bash
# è·å–UUID
sudo blkid /dev/vdb1
/dev/vdb1: UUID="12345678-1234-1234-1234-123456789abc" TYPE="ext4"

# ç¼–è¾‘fstabæ–‡ä»¶
sudo vim /etc/fstab

# æ·»åŠ æŒ‚è½½æ¡ç›®
UUID=12345678-1234-1234-1234-123456789abc /data ext4 defaults,noatime 0 2

# æµ‹è¯•fstabé…ç½®
sudo umount /data
sudo mount -a
df -h  # éªŒè¯æ˜¯å¦æ­£ç¡®æŒ‚è½½

# è®¾ç½®æƒé™
sudo chown -R www-data:www-data /data
sudo chmod 755 /data
```

### 8.3 å­˜å‚¨æ€§èƒ½ä¼˜åŒ–


**âš¡ æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©**
```
ä¸åŒæ–‡ä»¶ç³»ç»Ÿç‰¹ç‚¹ï¼š

ext4ï¼š
âœ… ç¨³å®šå¯é ï¼Œå…¼å®¹æ€§æœ€å¥½
âœ… é€‚åˆä¸€èˆ¬åº”ç”¨åœºæ™¯
âŒ å¤§æ–‡ä»¶æ€§èƒ½ä¸€èˆ¬

xfsï¼š  
âœ… å¤§æ–‡ä»¶å¤„ç†æ€§èƒ½ä¼˜ç§€
âœ… é€‚åˆæ•°æ®åº“å’Œå¤§æ•°æ®
âŒ ä¸æ”¯æŒç¼©å®¹

btrfsï¼š
âœ… æ”¯æŒå¿«ç…§å’Œå‹ç¼©
âœ… é€‚åˆç°ä»£åŒ–åº”ç”¨
âŒ ç›¸å¯¹è¾ƒæ–°ï¼Œç¨³å®šæ€§å¾…éªŒè¯

æ¨èé…ç½®ï¼š
â€¢ Webåº”ç”¨æ•°æ®ï¼šext4
â€¢ æ•°æ®åº“å­˜å‚¨ï¼šxfs  
â€¢ æ—¥å¿—æ–‡ä»¶ï¼šext4 + noatimeé€‰é¡¹
```

**ğŸ”§ æŒ‚è½½é€‰é¡¹ä¼˜åŒ–**
```bash
# é«˜æ€§èƒ½æŒ‚è½½é€‰é¡¹
/dev/vdb1 /data xfs defaults,noatime,nobarrier,largeio 0 2

å‚æ•°è¯´æ˜ï¼š
â€¢ noatimeï¼š    ä¸æ›´æ–°è®¿é—®æ—¶é—´ï¼Œæå‡æ€§èƒ½
â€¢ nobarrierï¼š  ç¦ç”¨å†™å±éšœï¼Œæå‡å†™å…¥æ€§èƒ½  
â€¢ largeioï¼š    ä¼˜åŒ–å¤§æ–‡ä»¶I/O
â€¢ defaultsï¼š   ä½¿ç”¨é»˜è®¤é€‰é¡¹

# æ•°æ®åº“ä¸“ç”¨ä¼˜åŒ–
/dev/vdc1 /var/lib/mysql xfs defaults,noatime,nobarrier,inode64 0 2

# SSDç¡¬ç›˜ä¼˜åŒ–
/dev/vdd1 /opt ext4 defaults,noatime,discard 0 2
# discardï¼šå¯ç”¨TRIMå‘½ä»¤ï¼Œä¼˜åŒ–SSDæ€§èƒ½
```

### 8.4 å­˜å‚¨ç›‘æ§å’Œç»´æŠ¤


**ğŸ“Š å­˜å‚¨ä½¿ç”¨ç›‘æ§**
```bash
# ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/vda1        40G  8.2G   30G  22% /
/dev/vdb1       100G   45G   50G  48% /data

# ç›®å½•ç©ºé—´ä½¿ç”¨ç»Ÿè®¡
du -sh /data/*
2.1G    /data/logs
15G     /data/database  
28G     /data/uploads

# æ‰¾å‡ºå¤§æ–‡ä»¶
find /data -type f -size +1G -exec ls -lh {} \;

# å®æ—¶ç›‘æ§ç£ç›˜I/O
iostat -x 1
Device    r/s     w/s     rkB/s    wkB/s   %util
vda      2.34   15.67    125.4    890.2    12.5
vdb     45.67   89.23   1234.5   2345.6    67.8
```

**âš ï¸ å­˜å‚¨ç»´æŠ¤è„šæœ¬**
```bash
#!/bin/bash
# å­˜å‚¨ç›‘æ§å’Œæ¸…ç†è„šæœ¬

DISK_THRESHOLD=80
LOG_DIR="/data/logs"
BACKUP_DIR="/data/backup"

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡
check_disk_usage() {
    usage=$(df /data | tail -1 | awk '{print $5}' | sed 's/%//')
    if [ $usage -gt $DISK_THRESHOLD ]; then
        echo "è­¦å‘Šï¼šç£ç›˜ä½¿ç”¨ç‡ ${usage}% è¶…è¿‡é˜ˆå€¼ ${DISK_THRESHOLD}%"
        
        # æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶ (ä¿ç•™7å¤©)
        find $LOG_DIR -name "*.log" -mtime +7 -delete
        
        # æ¸…ç†æ—§å¤‡ä»½æ–‡ä»¶ (ä¿ç•™30å¤©) 
        find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete
        
        # å‘é€å‘Šè­¦é€šçŸ¥
        echo "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå·²è‡ªåŠ¨æ¸…ç†" | mail -s "å­˜å‚¨å‘Šè­¦" admin@company.com
    fi
}

# å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
backup_data() {
    DATE=$(date +%Y%m%d_%H%M%S)
    tar -czf $BACKUP_DIR/app_backup_$DATE.tar.gz /data/app
    
    # ä¿æŒæœ€æ–°çš„5ä¸ªå¤‡ä»½æ–‡ä»¶
    ls -t $BACKUP_DIR/app_backup_*.tar.gz | tail -n +6 | xargs -r rm
}

# æ‰§è¡Œæ£€æŸ¥å’Œç»´æŠ¤
check_disk_usage
backup_data

echo "å­˜å‚¨ç»´æŠ¤å®Œæˆï¼š$(date)"
```

**ğŸ”„ å¿«ç…§å’Œå¤‡ä»½ç­–ç•¥**
```bash
# åˆ›å»ºå¿«ç…§ (ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹)
aliyun ecs CreateSnapshot \
  --DiskId d-bp1234567890abcde \
  --SnapshotName daily-backup-$(date +%Y%m%d)

# è‡ªåŠ¨å¿«ç…§ç­–ç•¥
cat > /etc/cron.d/disk-snapshot << 'EOF'
# æ¯å¤©å‡Œæ™¨3ç‚¹åˆ›å»ºå¿«ç…§
0 3 * * * root /usr/local/bin/create-snapshot.sh

# æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ¸…ç†æ—§å¿«ç…§
0 2 * * 0 root /usr/local/bin/cleanup-snapshots.sh
EOF

# å¿«ç…§æ¸…ç†è„šæœ¬
#!/bin/bash
# ä¿ç•™æœ€è¿‘7å¤©çš„å¿«ç…§ï¼Œåˆ é™¤æ›´æ—§çš„å¿«ç…§
CUTOFF_DATE=$(date -d "7 days ago" +%Y%m%d)

aliyun ecs DescribeSnapshots --DiskId d-bp1234567890abcde \
  | jq -r ".Snapshots[] | select(.CreationTime < \"$CUTOFF_DATE\") | .SnapshotId" \
  | xargs -I {} aliyun ecs DeleteSnapshot --SnapshotId {}
```

---

## 9. ğŸ“ˆ ç›‘æ§ä¸æ—¥å¿—æ”¶é›†è®¾ç½®


### 9.1 ç›‘æ§ä½“ç³»æ¦‚è¿°


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç³»ç»Ÿç›‘æ§**
```
ç³»ç»Ÿç›‘æ§ = æœåŠ¡å™¨çš„"å¥åº·ä½“æ£€ä»ª"

å°±åƒäººéœ€è¦å®šæœŸä½“æ£€ï¼š
â€¢ æµ‹é‡è¡€å‹å¿ƒç‡   â†’ ç›‘æ§CPUå†…å­˜ä½¿ç”¨ç‡
â€¢ æ£€æŸ¥è¡€æ¶²æŒ‡æ ‡   â†’ ç›‘æ§ç£ç›˜I/Oæ€§èƒ½  
â€¢ è§‚å¯Ÿèº«ä½“ç—‡çŠ¶   â†’ ç›‘æ§åº”ç”¨è¿è¡ŒçŠ¶æ€
â€¢ é¢„é˜²ç–¾ç—…å‘ç”Ÿ   â†’ é¢„è­¦ç³»ç»Ÿå¼‚å¸¸

ç›‘æ§çš„ç›®çš„ï¼š
âœ… åŠæ—¶å‘ç°é—®é¢˜
âœ… é¢„é˜²ç³»ç»Ÿæ•…éšœ
âœ… ä¼˜åŒ–èµ„æºé…ç½®
âœ… æä¾›è¿ç»´å†³ç­–ä¾æ®
```

**ğŸ“Š ç›‘æ§å±‚æ¬¡ç»“æ„**
```
ç›‘æ§ä½“ç³»æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ä¸šåŠ¡ç›‘æ§å±‚               â”‚  ç”¨æˆ·ä½“éªŒã€äº¤æ˜“æˆåŠŸç‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            åº”ç”¨ç›‘æ§å±‚               â”‚  åº”ç”¨æ€§èƒ½ã€æ¥å£å“åº”æ—¶é—´
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚            æœåŠ¡ç›‘æ§å±‚               â”‚  æ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            ç³»ç»Ÿç›‘æ§å±‚               â”‚  CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            åŸºç¡€è®¾æ–½å±‚               â”‚  æœåŠ¡å™¨ç¡¬ä»¶ã€ç½‘ç»œè®¾å¤‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ç³»ç»ŸæŒ‡æ ‡ç›‘æ§


**âš¡ æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**
```
CPUç›‘æ§æŒ‡æ ‡ï¼š
â€¢ CPUä½¿ç”¨ç‡ï¼š    è¡¡é‡å¤„ç†å™¨ç¹å¿™ç¨‹åº¦
â€¢ è´Ÿè½½å‡å€¼ï¼š     ç³»ç»Ÿæ•´ä½“è´Ÿè½½æƒ…å†µ  
â€¢ è¿›ç¨‹æ•°é‡ï¼š     è¿è¡Œè¿›ç¨‹ç»Ÿè®¡
â€¢ ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š   ç³»ç»Ÿè°ƒåº¦æ•ˆç‡

å†…å­˜ç›‘æ§æŒ‡æ ‡ï¼š
â€¢ å†…å­˜ä½¿ç”¨ç‡ï¼š   å¯ç”¨å†…å­˜ç™¾åˆ†æ¯”
â€¢ å†…å­˜ä½¿ç”¨é‡ï¼š   å·²ç”¨/æ€»è®¡å†…å­˜
â€¢ äº¤æ¢åˆ†åŒºï¼š     è™šæ‹Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ
â€¢ ç¼“å­˜å‘½ä¸­ç‡ï¼š   ç³»ç»Ÿç¼“å­˜æ•ˆç‡

ç£ç›˜ç›‘æ§æŒ‡æ ‡ï¼š
â€¢ ç£ç›˜ä½¿ç”¨ç‡ï¼š   å­˜å‚¨ç©ºé—´å ç”¨
â€¢ ç£ç›˜I/Oï¼š      è¯»å†™æ“ä½œé¢‘ç‡
â€¢ I/Oç­‰å¾…æ—¶é—´ï¼š  ç£ç›˜å“åº”å»¶è¿Ÿ
â€¢ ç£ç›˜é˜Ÿåˆ—é•¿åº¦ï¼š I/Oé˜Ÿåˆ—çŠ¶æ€

ç½‘ç»œç›‘æ§æŒ‡æ ‡ï¼š
â€¢ ç½‘ç»œæµé‡ï¼š     è¿›å‡ºæµé‡ç»Ÿè®¡
â€¢ è¿æ¥æ•°é‡ï¼š     ç½‘ç»œè¿æ¥çŠ¶æ€
â€¢ ä¸¢åŒ…ç‡ï¼š       ç½‘ç»œè´¨é‡æŒ‡æ ‡
â€¢ å“åº”æ—¶é—´ï¼š     ç½‘ç»œå»¶è¿Ÿæƒ…å†µ
```

**ğŸ› ï¸ åŸºç¡€ç›‘æ§å·¥å…·**
```bash
# top - å®æ—¶ç³»ç»ŸçŠ¶æ€
top
# æ˜¾ç¤ºCPUã€å†…å­˜ä½¿ç”¨æƒ…å†µå’Œè¿›ç¨‹çŠ¶æ€

# htop - å¢å¼ºç‰ˆtop (éœ€è¦å®‰è£…)
sudo apt install htop
htop

# iostat - ç£ç›˜I/Oç»Ÿè®¡  
sudo apt install sysstat
iostat -x 1

# sar - ç³»ç»Ÿæ´»åŠ¨æŠ¥å‘Š
sar -u 1 5    # CPUä½¿ç”¨ç‡ï¼Œæ¯ç§’é‡‡æ ·ï¼Œå…±5æ¬¡
sar -r 1 5    # å†…å­˜ä½¿ç”¨æƒ…å†µ
sar -d 1 5    # ç£ç›˜æ´»åŠ¨

# netstat - ç½‘ç»œè¿æ¥çŠ¶æ€
netstat -tuln  # æ˜¾ç¤ºç›‘å¬ç«¯å£
netstat -i     # æ˜¾ç¤ºç½‘ç»œæ¥å£ç»Ÿè®¡

# ss - æ›´ç°ä»£çš„ç½‘ç»œå·¥å…·
ss -tuln       # æ˜¾ç¤ºç›‘å¬çš„TCP/UDPç«¯å£
ss -s          # æ˜¾ç¤ºå¥—æ¥å­—ç»Ÿè®¡ä¿¡æ¯
```

### 9.3 ç›‘æ§ç³»ç»Ÿæ­å»º


**ğŸ“Š Prometheus + Grafana ç›‘æ§æ ˆ**
```bash
# 1. å®‰è£…Node Exporter (æ”¶é›†ç³»ç»ŸæŒ‡æ ‡)
wget https://github.com/prometheus/node_exporter/releases/download/v1.6.0/node_exporter-1.6.0.linux-amd64.tar.gz
tar xvfz node_exporter-1.6.0.linux-amd64.tar.gz
sudo cp node_exporter-1.6.0.linux-amd64/node_exporter /usr/local/bin/

# åˆ›å»ºsystemdæœåŠ¡
sudo tee /etc/systemd/system/node_exporter.service << 'EOF'
[Unit]
Description=Node Exporter
After=network.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/node_exporter --web.listen-address=:9100

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
sudo useradd --no-create-home --shell /bin/false prometheus
sudo systemctl daemon-reload
sudo systemctl enable node_exporter
sudo systemctl start node_exporter
```

**ğŸ³ Dockerç›‘æ§é…ç½®**
```yaml
# docker-compose.yml - ç›‘æ§æ ˆ
version: '3.8'
services:
  # Prometheus - æŒ‡æ ‡æ”¶é›†
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'

  # Grafana - ç›‘æ§é¢æ¿
  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    volumes:
      - grafana_data:/var/lib/grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin123

  # AlertManager - å‘Šè­¦ç®¡ç†
  alertmanager:
    image: prom/alertmanager:latest
    ports:
      - "9093:9093"
    volumes:
      - ./alertmanager.yml:/etc/alertmanager/alertmanager.yml

volumes:
  prometheus_data:
  grafana_data:
```

**ğŸ“ Prometheusé…ç½®æ–‡ä»¶**
```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # ç›‘æ§Prometheusè‡ªèº«
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # ç›‘æ§ç³»ç»ŸæŒ‡æ ‡
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:9100']
      
  # ç›‘æ§Nginx
  - job_name: 'nginx'
    static_configs:
      - targets: ['localhost:9113']
```

### 9.4 æ—¥å¿—æ”¶é›†ç³»ç»Ÿ


**ğŸ”¸ æ—¥å¿—æ”¶é›†çš„é‡è¦æ€§**
```
æ—¥å¿—æ”¶é›† = ç³»ç»Ÿçš„"é»‘åŒ£å­è®°å½•å™¨"

ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—æ”¶é›†ï¼š
â€¢ æ•…éšœè¯Šæ–­ï¼š   å‡ºé—®é¢˜æ—¶å¿«é€Ÿå®šä½åŸå› 
â€¢ å®‰å…¨å®¡è®¡ï¼š   è®°å½•ç³»ç»Ÿè®¿é—®å’Œæ“ä½œ  
â€¢ æ€§èƒ½åˆ†æï¼š   åˆ†æç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆ
â€¢ ä¸šåŠ¡åˆ†æï¼š   äº†è§£ç”¨æˆ·è¡Œä¸ºæ¨¡å¼

æ—¥å¿—ç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç³»ç»Ÿæ—¥å¿—   â”‚  åº”ç”¨æ—¥å¿—   â”‚  è®¿é—®æ—¥å¿—   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /var/log/   â”‚ åº”ç”¨è‡ªå®šä¹‰  â”‚ WebæœåŠ¡å™¨   â”‚
â”‚ syslog      â”‚ æ ¼å¼        â”‚ access.log  â”‚
â”‚ auth.log    â”‚             â”‚ error.log   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“‹ ç³»ç»Ÿæ—¥å¿—ç®¡ç†**
```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— (systemdç³»ç»Ÿ)
journalctl -f                    # å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
journalctl -u nginx             # æŸ¥çœ‹nginxæœåŠ¡æ—¥å¿—
journalctl --since "1 hour ago" # æŸ¥çœ‹1å°æ—¶å†…æ—¥å¿—
journalctl -p err               # åªæŸ¥çœ‹é”™è¯¯çº§åˆ«æ—¥å¿—

# ä¼ ç»Ÿç³»ç»Ÿæ—¥å¿—æ–‡ä»¶
tail -f /var/log/syslog         # ç³»ç»Ÿæ—¥å¿—
tail -f /var/log/auth.log       # è®¤è¯æ—¥å¿—
tail -f /var/log/kern.log       # å†…æ ¸æ—¥å¿—

# æ—¥å¿—è½®è½¬é…ç½®
sudo vim /etc/logrotate.d/myapp
/var/log/myapp/*.log {
    daily                   # æ¯å¤©è½®è½¬
    rotate 30              # ä¿ç•™30å¤©
    compress               # å‹ç¼©æ—§æ—¥å¿—
    delaycompress          # å»¶è¿Ÿå‹ç¼©
    missingok              # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
    notifempty            # ç©ºæ–‡ä»¶ä¸è½®è½¬
    postrotate            # è½®è½¬åæ‰§è¡Œå‘½ä»¤
        systemctl reload nginx
    endscript
}
```

**ğŸ“Š ELKæ—¥å¿—æ”¶é›†æ ˆ**
```yaml
# docker-compose.yml - ELK Stack
version: '3.8'
services:
  # Elasticsearch - æ—¥å¿—å­˜å‚¨
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.8.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms1g -Xmx1g"
      - xpack.security.enabled=false
    ports:
      - "9200:9200"
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data

  # Kibana - æ—¥å¿—å¯è§†åŒ–
  kibana:
    image: docker.elastic.co/kibana/kibana:8.8.0
    ports:
      - "5601:5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    depends_on:
      - elasticsearch

  # Logstash - æ—¥å¿—å¤„ç†
  logstash:
    image: docker.elastic.co/logstash/logstash:8.8.0
    ports:
      - "5044:5044"
    volumes:
      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf
    depends_on:
      - elasticsearch

  # Filebeat - æ—¥å¿—æ”¶é›†
  filebeat:
    image: docker.elastic.co/beats/filebeat:8.8.0
    volumes:
      - ./filebeat.yml:/usr/share/filebeat/filebeat.yml
      - /var/log:/var/log:ro
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
    depends_on:
      - logstash

volumes:
  elasticsearch_data:
```

**ğŸ“ Filebeaté…ç½®æ–‡ä»¶**
```yaml
# filebeat.yml
filebeat.inputs:
  # æ”¶é›†ç³»ç»Ÿæ—¥å¿—
  - type: log
    enabled: true
    paths:
      - /var/log/syslog
      - /var/log/auth.log
    fields:
      logtype: system
    fields_under_root: true

  # æ”¶é›†Nginxè®¿é—®æ—¥å¿—
  - type: log
    enabled: true
    paths:
      - /var/log/nginx/access.log
    fields:
      logtype: nginx_access
    fields_under_root: true

  # æ”¶é›†Nginxé”™è¯¯æ—¥å¿—
  - type: log  
    enabled: true
    paths:
      - /var/log/nginx/error.log
    fields:
      logtype: nginx_error
    fields_under_root: true

  # æ”¶é›†åº”ç”¨æ—¥å¿—
  - type: log
    enabled: true
    paths:
      - /opt/myapp/logs/*.log
    fields:
      logtype: application
    fields_under_root: true

output.logstash:
  hosts: ["logstash:5044"]

logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644
```

### 9.5 å‘Šè­¦é…ç½®


**ğŸš¨ å‘Šè­¦è§„åˆ™é…ç½®**
```yaml
# alert_rules.yml - Prometheuså‘Šè­¦è§„åˆ™
groups:
  - name: system_alerts
    rules:
      # CPUä½¿ç”¨ç‡å‘Šè­¦
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
          description: "å®ä¾‹ {{ $labels.instance }} CPUä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼: {{ $value }}%"

      # å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
      - alert: HighMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "å®ä¾‹ {{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡85%ï¼Œå½“å‰å€¼: {{ $value }}%"

      # ç£ç›˜ç©ºé—´å‘Šè­¦
      - alert: HighDiskUsage
        expr: (node_filesystem_size_bytes - node_filesystem_avail_bytes) / node_filesystem_size_bytes * 100 > 85
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ç£ç›˜ç©ºé—´ä¸è¶³"
          description: "å®ä¾‹ {{ $labels.instance }} ç£ç›˜ {{ $labels.mountpoint }} ä½¿ç”¨ç‡è¶…è¿‡85%"

      # æœåŠ¡å¼‚å¸¸å‘Šè­¦
      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "æœåŠ¡å®•æœº"
          description: "å®ä¾‹ {{ $labels.instance }} çš„æœåŠ¡ {{ $labels.job }} å·²å®•æœº"
```

**ğŸ“§ å‘Šè­¦é€šçŸ¥é…ç½®**
```yaml
# alertmanager.yml - å‘Šè­¦ç®¡ç†å™¨é…ç½®
global:
  smtp_smarthost: 'smtp.company.com:587'
  smtp_from: 'alerts@company.com'
  smtp_auth_username: 'alerts@company.com'
  smtp_auth_password: 'password'

route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'
  routes:
    # å…³é”®å‘Šè­¦ç«‹å³å‘é€
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
    
    # æ™®é€šå‘Šè­¦åˆ†ç»„å‘é€
    - match:
        severity: warning
      receiver: 'warning-alerts'

receivers:
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://webhook.company.com/alerts'

  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@company.com'
        subject: 'ğŸš¨ ä¸¥é‡å‘Šè­¦: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦è¯¦æƒ…: {{ .Annotations.description }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt }}
          å®ä¾‹ä¿¡æ¯: {{ .Labels.instance }}
          {{ end }}
    
    # çŸ­ä¿¡é€šçŸ¥ (é€šè¿‡webhookå®ç°)
    webhook_configs:
      - url: 'http://sms.company.com/send'
        send_resolved: true

  - name: 'warning-alerts'
    email_configs:
      - to: 'ops@company.com'
        subject: 'âš ï¸ ç³»ç»Ÿå‘Šè­¦: {{ .GroupLabels.alertname }}'
        body: |
          å‘Šè­¦ç»„: {{ .GroupLabels.alertname }}
          å‘Šè­¦æ•°é‡: {{ len .Alerts }}
          
          {{ range .Alerts }}
          - {{ .Annotations.summary }}: {{ .Annotations.description }}
          {{ end }}

# å‘Šè­¦æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
```

### 9.6 è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬


**ğŸ”§ ç³»ç»Ÿå¥åº·æ£€æŸ¥è„šæœ¬**
```bash
#!/bin/bash
# system_health_check.sh - ç³»ç»Ÿå¥åº·æ£€æŸ¥è„šæœ¬

# é…ç½®å‚æ•°
CPU_THRESHOLD=80
MEMORY_THRESHOLD=85
DISK_THRESHOLD=85
LOAD_THRESHOLD=2.0
LOG_FILE="/var/log/health_check.log"
EMAIL="admin@company.com"

# æ—¥å¿—å‡½æ•°
log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a $LOG_FILE
}

# CPUæ£€æŸ¥
check_cpu() {
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    if (( $(echo "$CPU_USAGE > $CPU_THRESHOLD" | bc -l) )); then
        log_message "âš ï¸  CPUä½¿ç”¨ç‡è¿‡é«˜: ${CPU_USAGE}%"
        return 1
    fi
    return 0
}

# å†…å­˜æ£€æŸ¥
check_memory() {
    MEMORY_USAGE=$(free | grep Mem | awk '{printf "%.1f", $3/$2 * 100.0}')
    if (( $(echo "$MEMORY_USAGE > $MEMORY_THRESHOLD" | bc -l) )); then
        log_message "âš ï¸  å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${MEMORY_USAGE}%"
        return 1
    fi
    return 0
}

# ç£ç›˜æ£€æŸ¥
check_disk() {
    DISK_ISSUES=0
    while IFS= read -r line; do
        USAGE=$(echo $line | awk '{print $5}' | sed 's/%//')
        MOUNT=$(echo $line | awk '{print $6}')
        if [[ $USAGE -gt $DISK_THRESHOLD ]]; then
            log_message "âš ï¸  ç£ç›˜ç©ºé—´ä¸è¶³: $MOUNT ä½¿ç”¨ç‡ ${USAGE}%"
            DISK_ISSUES=1
        fi
    done <<< "$(df -h | grep -E '^/dev/')"
    return $DISK_ISSUES
}

# ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥
check_load() {
    LOAD_1MIN=$(uptime | awk '{print $(NF-2)}' | sed 's/,//')
    if (( $(echo "$LOAD_1MIN > $LOAD_THRESHOLD" | bc -l) )); then
        log_message "âš ï¸  ç³»ç»Ÿè´Ÿè½½è¿‡é«˜: $LOAD_1MIN"
        return 1
    fi
    return 0
}

# æœåŠ¡æ£€æŸ¥
check_services() {
    SERVICES=("nginx" "mysql" "redis")
    SERVICE_ISSUES=0
    
    for service in "${SERVICES[@]}"; do
        if ! systemctl is-active --quiet $service; then
            log_message "âŒ æœåŠ¡å¼‚å¸¸: $service æœªè¿è¡Œ"
            SERVICE_ISSUES=1
            
            # å°è¯•é‡å¯æœåŠ¡
            log_message "ğŸ”„ å°è¯•é‡å¯æœåŠ¡: $service"
            systemctl restart $service
            
            if systemctl is-active --quiet $service; then
                log_message "âœ… æœåŠ¡é‡å¯æˆåŠŸ: $service"
            else
                log_message "âŒ æœåŠ¡é‡å¯å¤±è´¥: $service"
            fi
        fi
    done
    
    return $SERVICE_ISSUES
}

# ç½‘ç»œè¿æ¥æ£€æŸ¥
check_network() {
    if ! ping -c 3 8.8.8.8 >/dev/null 2>&1; then
        log_message "âŒ ç½‘ç»œè¿æ¥å¼‚å¸¸"
        return 1
    fi
    return 0
}

# å‘é€å‘Šè­¦é‚®ä»¶
send_alert() {
    SUBJECT="ğŸš¨ æœåŠ¡å™¨å¥åº·æ£€æŸ¥å‘Šè­¦ - $(hostname)"
    BODY="æœåŠ¡å™¨ $(hostname) æ£€æµ‹åˆ°ä»¥ä¸‹é—®é¢˜ï¼š\n\n$(tail -10 $LOG_FILE)\n\nè¯·åŠæ—¶å¤„ç†ã€‚"
    echo -e "$BODY" | mail -s "$SUBJECT" $EMAIL
}

# ä¸»æ£€æŸ¥æµç¨‹
main() {
    log_message "ğŸ” å¼€å§‹ç³»ç»Ÿå¥åº·æ£€æŸ¥"
    
    ISSUES=0
    
    check_cpu || ((ISSUES++))
    check_memory || ((ISSUES++))
    check_disk || ((ISSUES++))
    check_load || ((ISSUES++))
    check_services || ((ISSUES++))
    check_network || ((ISSUES++))
    
    if [[ $ISSUES -eq 0 ]]; then
        log_message "âœ… ç³»ç»Ÿå¥åº·æ£€æŸ¥æ­£å¸¸"
    else
        log_message "âš ï¸  å‘ç° $ISSUES ä¸ªé—®é¢˜ï¼Œå‘é€å‘Šè­¦é€šçŸ¥"
        send_alert
    fi
    
    log_message "ğŸ ç³»ç»Ÿå¥åº·æ£€æŸ¥å®Œæˆ"
}

# æ‰§è¡Œæ£€æŸ¥
main
```

**ğŸ“… å®šæ—¶ä»»åŠ¡é…ç½®**
```bash
# é…ç½®crontabå®šæ—¶ä»»åŠ¡
sudo crontab -e

# æ·»åŠ ä»¥ä¸‹ä»»åŠ¡
# æ¯5åˆ†é’Ÿæ‰§è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥
*/5 * * * * /usr/local/bin/system_health_check.sh

# æ¯å°æ—¶æ‰§è¡Œç£ç›˜æ¸…ç†
0 * * * * /usr/local/bin/disk_cleanup.sh

# æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œæ—¥å¿—è½®è½¬
0 3 * * * /usr/sbin/logrotate /etc/logrotate.conf

# æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œç³»ç»Ÿæ›´æ–°æ£€æŸ¥
0 2 * * 0 /usr/local/bin/system_update_check.sh

# æ¯æœˆ1å·å‡Œæ™¨1ç‚¹æ‰§è¡Œç£ç›˜ç¢ç‰‡æ•´ç†
0 1 1 * * /usr/local/bin/disk_maintenance.sh
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‘å¹³å°éƒ¨ç½²ï¼šå¿«é€Ÿåˆ›å»ºå’Œç®¡ç†äº‘æœåŠ¡å™¨çš„ç°ä»£åŒ–æ–¹å¼
ğŸ”¸ äº‘é•œåƒï¼šé¢„è£…æ“ä½œç³»ç»Ÿå’Œè½¯ä»¶çš„æœåŠ¡å™¨"æ¨¡æ¿"
ğŸ”¸ å®ä¾‹è§„æ ¼ï¼šæ ¹æ®æ€§èƒ½éœ€æ±‚é€‰æ‹©åˆé€‚çš„CPU/å†…å­˜/å­˜å‚¨é…ç½®
ğŸ”¸ cloud-initï¼šæœåŠ¡å™¨åˆ›å»ºæ—¶è‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–é…ç½®çš„å·¥å…·
ğŸ”¸ å®‰å…¨ç»„ï¼šäº‘æœåŠ¡å™¨çš„ç½‘ç»œé˜²ç«å¢™è§„åˆ™é›†
ğŸ”¸ SSHå¯†é’¥å¯¹ï¼šæ¯”å¯†ç æ›´å®‰å…¨çš„èº«ä»½è®¤è¯æ–¹å¼
ğŸ”¸ ç”¨æˆ·æ•°æ®æ³¨å…¥ï¼šåœ¨åˆ›å»ºæ—¶æ¤å…¥è‡ªå®šä¹‰é…ç½®è„šæœ¬
ğŸ”¸ å­˜å‚¨å·ï¼šäº‘æœåŠ¡å™¨çš„å¯æ‰©å±•å­˜å‚¨ç©ºé—´
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šå®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€å¹¶åŠæ—¶å‘ç°é—®é¢˜
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ äº‘éƒ¨ç½²ä¸ä¼ ç»Ÿéƒ¨ç½²çš„åŒºåˆ«**
```
ä¼ ç»Ÿéƒ¨ç½²ç‰¹ç‚¹ï¼š
â€¢ ç¡¬ä»¶é‡‡è´­å‘¨æœŸé•¿ï¼Œæˆæœ¬é«˜
â€¢ éœ€è¦ä¸“ä¸šæœºæˆ¿å’Œè¿ç»´äººå‘˜
â€¢ æ‰©å±•å›°éš¾ï¼Œèµ„æºåˆ©ç”¨ç‡ä½
â€¢ å•ç‚¹æ•…éšœé£é™©é«˜

äº‘å¹³å°éƒ¨ç½²ä¼˜åŠ¿ï¼š
â€¢ å‡ åˆ†é’Ÿå³å¯è·å¾—æœåŠ¡å™¨
â€¢ æŒ‰éœ€ä»˜è´¹ï¼Œæˆæœ¬å¯æ§
â€¢ å¼¹æ€§æ‰©å±•ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜  
â€¢ å¤šå¯ç”¨åŒºï¼Œé«˜å¯ç”¨ä¿éšœ
```

**ğŸ”¹ è‡ªåŠ¨åŒ–åˆå§‹åŒ–çš„ä»·å€¼**
```
æ‰‹åŠ¨é…ç½®é—®é¢˜ï¼š
â€¢ é‡å¤æ€§å·¥ä½œï¼Œæ•ˆç‡ä½
â€¢ äººä¸ºæ“ä½œæ˜“å‡ºé”™
â€¢ é…ç½®ä¸ä¸€è‡´ï¼Œéš¾ç®¡ç†
â€¢ æ— æ³•å¿«é€Ÿæ‰¹é‡éƒ¨ç½²

è‡ªåŠ¨åŒ–åˆå§‹åŒ–ä¼˜åŠ¿ï¼š
â€¢ é…ç½®æ ‡å‡†åŒ–ï¼Œå‡å°‘é”™è¯¯
â€¢ å¿«é€Ÿæ‰¹é‡éƒ¨ç½²
â€¢ ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯è¿½æº¯
â€¢ æé«˜è¿ç»´æ•ˆç‡
```

**ğŸ”¹ ç›‘æ§å‘Šè­¦çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼š
â€¢ åŠæ—¶å‘ç°ç³»ç»Ÿé—®é¢˜
â€¢ é¢„é˜²æ•…éšœæ‰©å¤§å½±å“
â€¢ ä¼˜åŒ–èµ„æºé…ç½®
â€¢ æä¾›å†³ç­–ä¾æ®

ç›‘æ§å±‚æ¬¡ï¼š
â€¢ åŸºç¡€è®¾æ–½ç›‘æ§ï¼šç¡¬ä»¶èµ„æºçŠ¶æ€
â€¢ ç³»ç»Ÿç›‘æ§ï¼šæ“ä½œç³»ç»Ÿæ€§èƒ½
â€¢ åº”ç”¨ç›‘æ§ï¼šä¸šåŠ¡åº”ç”¨çŠ¶æ€
â€¢ ä¸šåŠ¡ç›‘æ§ï¼šç”¨æˆ·ä½“éªŒæŒ‡æ ‡
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ æ–°æ‰‹éƒ¨ç½²å»ºè®®**
```
ç¬¬ä¸€æ¬¡äº‘éƒ¨ç½²æ¨èæµç¨‹ï¼š

1ï¸âƒ£ é€‰æ‹©äº‘å¹³å°
â€¢ å›½å†…ä¸šåŠ¡ï¼šé˜¿é‡Œäº‘/è…¾è®¯äº‘
â€¢ å›½é™…ä¸šåŠ¡ï¼šAWS/Azure
â€¢ å­¦ä¹ æµ‹è¯•ï¼šä»»é€‰ä¸€å®¶

2ï¸âƒ£ é•œåƒé€‰æ‹©
â€¢ æ¨èï¼šUbuntu 20.04 LTS
â€¢ åŸå› ï¼šæ–‡æ¡£ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒ

3ï¸âƒ£ å®ä¾‹è§„æ ¼
â€¢ å­¦ä¹ ç¯å¢ƒï¼š1æ ¸2G
â€¢ æµ‹è¯•ç¯å¢ƒï¼š2æ ¸4G
â€¢ ç”Ÿäº§ç¯å¢ƒï¼š4æ ¸8Gèµ·

4ï¸âƒ£ ç½‘ç»œé…ç½®
â€¢ åˆ›å»ºVPCå’Œå­ç½‘
â€¢ é…ç½®å®‰å…¨ç»„è§„åˆ™
â€¢ åˆ†é…å…¬ç½‘IP

5ï¸âƒ£ å¯†é’¥ç®¡ç†
â€¢ åˆ›å»ºSSHå¯†é’¥å¯¹
â€¢ ç¦ç”¨å¯†ç ç™»å½•
â€¢ é…ç½®SSHå®¢æˆ·ç«¯
```

**ğŸ”’ å®‰å…¨é…ç½®æœ€ä½³å®è·µ**
```
å®‰å…¨åŠ å›ºæ¸…å•ï¼š

ç³»ç»Ÿå®‰å…¨ï¼š
âœ… ä¿®æ”¹SSHé»˜è®¤ç«¯å£
âœ… ç¦ç”¨rootç›´æ¥ç™»å½•
âœ… ä½¿ç”¨SSHå¯†é’¥è®¤è¯
âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
âœ… å®šæœŸæ›´æ–°ç³»ç»Ÿè¡¥ä¸

ç½‘ç»œå®‰å…¨ï¼š
âœ… åˆç†åˆ’åˆ†å­ç½‘
âœ… é™åˆ¶å®‰å…¨ç»„è§„åˆ™
âœ… ä½¿ç”¨VPCå†…ç½‘é€šä¿¡
âœ… é…ç½®è®¿é—®æ§åˆ¶åˆ—è¡¨

åº”ç”¨å®‰å…¨ï¼š
âœ… ä½¿ç”¨éç‰¹æƒç”¨æˆ·è¿è¡Œåº”ç”¨
âœ… å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
âœ… åŠ å¯†æ•æ„Ÿä¿¡æ¯
âœ… é…ç½®æ—¥å¿—å®¡è®¡
```

**ğŸ“Š è¿ç»´ç›‘æ§ç­–ç•¥**
```
ç›‘æ§ä½“ç³»å»ºè®¾ï¼š

åŸºç¡€ç›‘æ§ï¼š
â€¢ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
â€¢ ç³»ç»Ÿè´Ÿè½½ã€è¿›ç¨‹çŠ¶æ€
â€¢ æœåŠ¡å¯ç”¨æ€§æ£€æŸ¥

åº”ç”¨ç›‘æ§ï¼š
â€¢ åº”ç”¨å“åº”æ—¶é—´
â€¢ é”™è¯¯ç‡ç»Ÿè®¡
â€¢ ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

å‘Šè­¦é…ç½®ï¼š
â€¢ åˆ†çº§å‘Šè­¦æœºåˆ¶
â€¢ å¤šæ¸ é“é€šçŸ¥
â€¢ å‘Šè­¦æŠ‘åˆ¶å’Œåˆ†ç»„
â€¢ è‡ªåŠ¨æ¢å¤æœºåˆ¶

æ—¥å¿—ç®¡ç†ï¼š
â€¢ é›†ä¸­æ—¥å¿—æ”¶é›†
â€¢ æ—¥å¿—åˆ†æå’Œæ£€ç´¢
â€¢ æ—¥å¿—è½®è½¬å’Œå½’æ¡£
â€¢ å®‰å…¨å®¡è®¡æ—¥å¿—
```

### 10.4 å¸¸è§é—®é¢˜è§£å†³


**ğŸ”§ éƒ¨ç½²å¸¸è§é—®é¢˜**
```
é—®é¢˜1ï¼šSSHè¿æ¥å¤±è´¥
åŸå› ï¼šå®‰å…¨ç»„è§„åˆ™æœªå¼€æ”¾SSHç«¯å£
è§£å†³ï¼šæ£€æŸ¥å®‰å…¨ç»„æ˜¯å¦å…è®¸22ç«¯å£è®¿é—®

é—®é¢˜2ï¼šcloud-initè„šæœ¬æ‰§è¡Œå¤±è´¥
åŸå› ï¼šè„šæœ¬è¯­æ³•é”™è¯¯æˆ–ç½‘ç»œé—®é¢˜
è§£å†³ï¼šæŸ¥çœ‹/var/log/cloud-init-output.logæ—¥å¿—

é—®é¢˜3ï¼šç£ç›˜æŒ‚è½½å¤±è´¥
åŸå› ï¼šfstabé…ç½®é”™è¯¯æˆ–ç£ç›˜æœªæ ¼å¼åŒ–
è§£å†³ï¼šæ£€æŸ¥UUIDå’ŒæŒ‚è½½é€‰é¡¹ï¼Œé‡æ–°æŒ‚è½½æµ‹è¯•

é—®é¢˜4ï¼šæœåŠ¡å¯åŠ¨å¼‚å¸¸
åŸå› ï¼šç«¯å£å†²çªæˆ–é…ç½®æ–‡ä»¶é”™è¯¯
è§£å†³ï¼šæŸ¥çœ‹systemctl statuså’Œæ—¥å¿—å®šä½é—®é¢˜

é—®é¢˜5ï¼šç›‘æ§æ•°æ®å¼‚å¸¸
åŸå› ï¼šæ—¶é—´åŒæ­¥é—®é¢˜æˆ–é‡‡é›†å™¨é…ç½®é”™è¯¯
è§£å†³ï¼šæ£€æŸ¥NTPæ—¶é—´åŒæ­¥ï¼ŒéªŒè¯é…ç½®æ–‡ä»¶
```

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```
ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–ï¼š

ç¡¬ä»¶å±‚é¢ï¼š
â€¢ é€‰æ‹©SSDå­˜å‚¨æå‡I/Oæ€§èƒ½
â€¢ æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©å®ä¾‹ç±»å‹
â€¢ åˆç†é…ç½®å†…å­˜é¿å…swap

ç³»ç»Ÿå±‚é¢ï¼š
â€¢ è°ƒæ•´å†…æ ¸å‚æ•°
â€¢ ä¼˜åŒ–æ–‡ä»¶ç³»ç»ŸæŒ‚è½½å‚æ•°
â€¢ é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶

åº”ç”¨å±‚é¢ï¼š
â€¢ ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“å‹åŠ›
â€¢ ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢å’Œç´¢å¼•
â€¢ å®ç°è´Ÿè½½å‡è¡¡åˆ†æ•£å‹åŠ›
â€¢ å¯ç”¨Gzipå‹ç¼©èŠ‚çœå¸¦å®½
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- äº‘å¹³å°éƒ¨ç½²å¿«åˆå¥½ï¼Œé•œåƒè§„æ ¼è¦é€‰å¯¹
- å®‰å…¨ç»„é‡Œå®šè§„åˆ™ï¼ŒSSHå¯†é’¥æ›´å¯é   
- è‡ªåŠ¨åˆå§‹çœäººå·¥ï¼Œç›‘æ§å‘Šè­¦ä¸èƒ½å°‘
- å­˜å‚¨å¤‡ä»½è¦åšå¥½ï¼Œæ—¥å¿—æ”¶é›†é—®é¢˜æ‰¾