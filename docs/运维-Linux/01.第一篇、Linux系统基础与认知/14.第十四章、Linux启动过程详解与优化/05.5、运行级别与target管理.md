---
title: 5、运行级别与target管理
---
## 📚 目录

1. [SysV运行级别基础概念](#1-SysV运行级别基础概念)
2. [systemd target映射关系](#2-systemd-target映射关系)
3. [默认target设置与管理](#3-默认target设置与管理)
4. [target切换命令详解](#4-target切换命令详解)
5. [各种运行模式深入解析](#5-各种运行模式深入解析)
6. [实际操作与故障处理](#6-实际操作与故障处理)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔄 SysV运行级别基础概念


### 1.1 什么是运行级别

**🎯 通俗理解**：运行级别就像是Linux系统的"工作模式"，类似于手机的飞行模式、静音模式一样。

```
生活类比：
手机模式          Linux运行级别
正常模式    →     图形界面模式（级别5）
飞行模式    →     关机模式（级别0）
静音模式    →     单用户模式（级别1）
省电模式    →     多用户无网络模式（级别2）
```

**💡 核心概念**：
- **运行级别**：决定系统启动时运行哪些服务
- **SysV**：传统的System V初始化系统
- **每个级别**：代表不同的系统状态和功能

### 1.2 传统SysV运行级别详解


**📊 运行级别对照表**

| 级别 | **名称** | **功能说明** | **实际用途** |
|------|---------|-------------|-------------|
| **0** | `关机级别` | 系统关机状态 | 执行关机操作 |
| **1** | `单用户模式` | 仅root用户，最小服务 | 系统维护、密码重置 |
| **2** | `多用户无网络` | 多用户但无网络服务 | 本地维护工作 |
| **3** | `完整多用户` | 完整的多用户命令行模式 | 服务器标准模式 |
| **4** | `未定义` | 用户自定义级别 | 特殊需求定制 |
| **5** | `图形界面` | 完整的图形用户界面 | 桌面用户模式 |
| **6** | `重启级别` | 系统重启状态 | 执行重启操作 |

**🔍 级别选择逻辑**：
```
服务器环境 → 选择级别3（命令行，节省资源）
桌面环境 → 选择级别5（图形界面，用户友好）
维修模式 → 选择级别1（单用户，安全操作）
```

### 1.3 SysV的工作机制


**⚙️ 启动流程**：
```
系统启动 → 内核加载 → init进程 → 读取/etc/inittab → 进入指定运行级别
                                            ↓
                                    执行对应级别的启动脚本
```

**📁 关键文件位置**：
```bash
/etc/inittab          # 运行级别配置文件（传统系统）
/etc/rc.d/rc0.d/      # 级别0的启动脚本
/etc/rc.d/rc1.d/      # 级别1的启动脚本
/etc/rc.d/rc3.d/      # 级别3的启动脚本
/etc/rc.d/rc5.d/      # 级别5的启动脚本
```

---

## 2. 🎯 systemd target映射关系


### 2.1 为什么要从SysV转向systemd


**🔄 技术演进原因**：
- **并行启动**：systemd可以同时启动多个服务，比SysV的串行启动快
- **依赖管理**：更智能的服务依赖关系处理
- **统一管理**：统一的服务、设备、网络管理
- **现代化需求**：更好地支持现代硬件和容器技术

### 2.2 target概念理解


**💡 什么是target**：
- **通俗解释**：target就是"目标状态"，告诉系统应该达到什么样的工作状态
- **与运行级别关系**：target是systemd对传统运行级别的现代化替代

**🔗 映射关系表**

| **传统运行级别** | **systemd target** | **target文件名** | **功能说明** |
|----------------|-------------------|-----------------|-------------|
| **0** | `poweroff.target` | `poweroff.target` | 关机状态 |
| **1** | `rescue.target` | `rescue.target` | 救援模式（单用户） |
| **2,3,4** | `multi-user.target` | `multi-user.target` | 多用户命令行模式 |
| **5** | `graphical.target` | `graphical.target` | 图形界面模式 |
| **6** | `reboot.target` | `reboot.target` | 重启状态 |

### 2.3 target的工作原理


**🧩 target结构图**：
```
graphical.target
       ↓
 multi-user.target
       ↓
   basic.target
       ↓
   sysinit.target
```

**📋 依赖关系说明**：
- **graphical.target** 依赖 **multi-user.target**
- **multi-user.target** 依赖 **basic.target**  
- **basic.target** 依赖 **sysinit.target**

**💡 理解要点**：启动图形界面时，系统会自动启动所有依赖的target

---

## 3. ⚙️ 默认target设置与管理


### 3.1 查看当前系统target状态


**🔍 查看默认target**：
```bash
# 查看默认target
systemctl get-default

# 查看当前运行的target
systemctl list-units --type=target
```

**📊 输出示例**：
```
[root@linux ~]# systemctl get-default
graphical.target

[root@linux ~]# systemctl list-units --type=target
UNIT                   LOAD   ACTIVE SUB    DESCRIPTION
basic.target          loaded active active Basic System
graphical.target      loaded active active Graphical Interface
multi-user.target     loaded active active Multi-User System
```

### 3.2 设置默认target


**⚠️ 重要提醒**：
- **服务器环境**：建议设置为`multi-user.target`（节省资源）
- **桌面环境**：设置为`graphical.target`（用户友好）

**🔧 设置方法**：
```bash
# 设置默认为多用户模式（服务器推荐）
systemctl set-default multi-user.target

# 设置默认为图形界面模式
systemctl set-default graphical.target

# 验证设置
systemctl get-default
```

### 3.3 target文件位置


**📁 系统target文件**：
```bash
/usr/lib/systemd/system/    # 系统默认target文件
/etc/systemd/system/        # 管理员自定义target文件
```

**🔗 符号链接机制**：
```bash
# 查看默认target的符号链接
ls -l /etc/systemd/system/default.target

# 输出示例：
# /etc/systemd/system/default.target -> /lib/systemd/system/graphical.target
```

---

## 4. 🚀 target切换命令详解


### 4.1 临时切换target


**💡 概念说明**：临时切换只影响当前会话，重启后恢复默认设置

**🔧 基本切换命令**：
```bash
# 切换到多用户模式（相当于运行级别3）
systemctl isolate multi-user.target

# 切换到图形界面模式（相当于运行级别5）
systemctl isolate graphical.target

# 切换到救援模式（相当于运行级别1）
systemctl isolate rescue.target
```

### 4.2 传统命令兼容


**🔄 新旧命令对比**：

| **功能** | **传统SysV命令** | **systemd命令** | **target方式** |
|---------|-----------------|----------------|---------------|
| **切换到级别3** | `init 3` | `systemctl isolate multi-user.target` | 多用户模式 |
| **切换到级别5** | `init 5` | `systemctl isolate graphical.target` | 图形模式 |
| **切换到级别1** | `init 1` | `systemctl isolate rescue.target` | 救援模式 |
| **关机** | `init 0` | `systemctl isolate poweroff.target` | 关机 |
| **重启** | `init 6` | `systemctl isolate reboot.target` | 重启 |

### 4.3 快捷切换命令


**⚡ 常用快捷命令**：
```bash
# 关机相关
systemctl poweroff        # 关机
systemctl reboot          # 重启
systemctl halt            # 停止系统

# 模式切换
systemctl rescue          # 进入救援模式
systemctl emergency       # 进入紧急模式
```

---

## 5. 🛠️ 各种运行模式深入解析


### 5.1 rescue.target 救援模式详解


**🚨 什么是救援模式**：
- **通俗理解**：系统的"安全模式"，类似Windows安全模式
- **使用场景**：系统出问题时用来修复

**🔧 救援模式特点**：
```
✅ 只启动最基本的服务
✅ 只有root用户可以登录  
✅ 文件系统以只读方式挂载
✅ 网络服务通常不启动
✅ 提供基本的系统修复环境
```

**💻 进入救援模式**：
```bash
# 临时切换到救援模式
systemctl isolate rescue.target

# 或使用传统方式
systemctl rescue
```

### 5.2 emergency.target 紧急模式详解


**🆘 紧急模式特点**：
- **更极端的修复模式**：比救援模式启动的服务更少
- **根文件系统只读**：防止数据损坏
- **最小化环境**：只提供最基本的修复工具

**⚠️ 使用场景**：
```
🔸 文件系统损坏严重
🔸 救援模式无法启动
🔸 需要修复根分区问题
🔸 系统严重崩溃情况
```

**💻 进入紧急模式**：
```bash
# 进入紧急模式
systemctl isolate emergency.target

# 或使用快捷命令
systemctl emergency
```

### 5.3 multi-user.target 多用户模式详解


**👥 多用户模式特点**：
- **完整的多用户支持**：多个用户可以同时登录
- **网络服务启动**：SSH、FTP等网络服务正常运行
- **无图形界面**：纯命令行环境，节省资源
- **服务器标准模式**：大多数服务器的默认运行模式

**🎯 适用场景**：
```
✅ 服务器环境
✅ 远程管理需求
✅ 资源受限环境
✅ 批处理作业环境
```

### 5.4 graphical.target 图形模式详解


**🖥️ 图形模式特点**：
- **完整图形界面**：包含桌面环境
- **包含多用户功能**：继承multi-user.target的所有功能
- **资源消耗较高**：需要更多内存和CPU
- **用户友好**：提供可视化操作界面

**🎯 适用场景**：
```
✅ 桌面用户环境
✅ 需要图形工具的管理任务
✅ 开发和测试环境
✅ 多媒体应用需求
```

---

## 6. 🔧 实际操作与故障处理


### 6.1 开机时选择target


**⚙️ GRUB启动时修改**：
1. **重启系统**，在GRUB菜单出现时按`e`键
2. **找到linux行**，在末尾添加target参数
3. **常用参数**：
   ```
   systemd.unit=rescue.target          # 救援模式
   systemd.unit=emergency.target       # 紧急模式  
   systemd.unit=multi-user.target      # 多用户模式
   ```
4. **按Ctrl+X启动**

### 6.2 忘记root密码的处理


**🔐 使用rescue模式重置密码**：
```bash
# 1. 开机时进入救援模式
# 在GRUB中添加：systemd.unit=rescue.target

# 2. 重新挂载文件系统为可写
mount -o remount,rw /

# 3. 重置root密码
passwd root

# 4. 重启系统
systemctl reboot
```

### 6.3 系统启动故障排查


**🔍 常见故障与解决方案**：

```
问题：图形界面无法启动
解决：
1. systemctl isolate multi-user.target  # 切换到命令行
2. systemctl status graphical.target    # 检查图形target状态
3. journalctl -u graphical.target       # 查看详细日志

问题：网络服务无法启动
解决：
1. systemctl isolate rescue.target      # 进入救援模式
2. systemctl start NetworkManager       # 手动启动网络服务
3. systemctl enable NetworkManager      # 设置开机自启动
```

### 6.4 target依赖关系调试


**🔍 查看target依赖**：
```bash
# 查看target的依赖关系
systemctl list-dependencies graphical.target

# 查看特定服务的依赖
systemctl list-dependencies sshd.service

# 检查target是否正常
systemctl status multi-user.target
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 运行级别：传统的系统工作模式划分（0-6）
🔸 systemd target：现代化的系统状态管理方式
🔸 映射关系：运行级别与target的对应关系
🔸 默认target：系统启动时自动进入的工作模式
🔸 临时切换：不影响默认设置的临时模式切换
```

### 7.2 关键操作命令速查


**📝 常用命令汇总**：

| **操作** | **命令** | **说明** |
|---------|---------|----------|
| **查看默认target** | `systemctl get-default` | 显示系统默认启动的target |
| **设置默认target** | `systemctl set-default multi-user.target` | 设置默认启动模式 |
| **临时切换** | `systemctl isolate rescue.target` | 临时切换到指定模式 |
| **查看当前target** | `systemctl list-units --type=target` | 显示当前运行的target |
| **进入救援模式** | `systemctl rescue` | 快速进入救援模式 |
| **进入紧急模式** | `systemctl emergency` | 快速进入紧急模式 |

### 7.3 实际应用场景指导


**🎯 服务器环境最佳实践**：
```
推荐设置：multi-user.target
原因：
✓ 节省系统资源
✓ 提高安全性（无图形界面）
✓ 更适合远程管理
✓ 减少潜在故障点
```

**🖥️ 桌面环境最佳实践**：
```
推荐设置：graphical.target
原因：
✓ 提供友好的用户界面
✓ 支持图形化应用程序
✓ 便于本地操作和管理
✓ 适合日常办公使用
```

### 7.4 故障处理思路


**🚨 系统故障处理流程**：
```
1. 判断故障类型
   ├─ 图形界面问题 → 切换到multi-user.target
   ├─ 服务启动问题 → 进入rescue.target
   └─ 严重系统问题 → 进入emergency.target

2. 排查和修复
   ├─ 查看系统日志：journalctl
   ├─ 检查服务状态：systemctl status
   └─ 重新配置服务：systemctl enable/disable

3. 验证修复结果
   ├─ 重启系统测试
   ├─ 检查默认target设置
   └─ 确认服务正常运行
```

### 7.5 学习记忆要点


**🧠 记忆口诀**：
```
级别0和6关重启，级别1单用户修复
级别3多用户命令行，级别5图形界面美丽
systemd用target替代，rescue紧急来救急
```

**⚠️ 注意事项**：
- **生产环境操作需谨慎**：切换target前确保了解影响范围
- **备份重要配置**：修改默认target前建议备份当前配置  
- **测试环境先验证**：重要操作先在测试环境验证
- **了解依赖关系**：理解不同target之间的依赖关系

**🎯 学习建议**：
- **实际操作练习**：在虚拟机中反复练习各种切换操作
- **日志分析能力**：学会使用journalctl分析系统日志
- **故障模拟**：主动创建故障场景，练习修复技能
- **文档查阅**：熟悉man手册和官方文档的使用

**核心记忆**：
- systemd target是现代Linux系统状态管理的核心
- 理解运行级别到target的映射关系是基础
- 掌握切换命令和故障处理方法是关键技能
- 根据实际使用场景选择合适的默认target设置