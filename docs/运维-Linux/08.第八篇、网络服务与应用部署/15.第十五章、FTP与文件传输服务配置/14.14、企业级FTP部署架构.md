---
title: 14ã€ä¼ä¸šçº§FTPéƒ¨ç½²æ¶æ„
---
## ğŸ“š ç›®å½•

1. [FTPæœåŠ¡é«˜å¯ç”¨éƒ¨ç½²](#1-FTPæœåŠ¡é«˜å¯ç”¨éƒ¨ç½²)
2. [è´Ÿè½½å‡è¡¡é…ç½®](#2-è´Ÿè½½å‡è¡¡é…ç½®)
3. [é›†ç¾¤æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆ](#3-é›†ç¾¤æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆ)
4. [è‡ªåŠ¨æ•…éšœåˆ‡æ¢](#4-è‡ªåŠ¨æ•…éšœåˆ‡æ¢)
5. [ç›‘æ§å‘Šè­¦é…ç½®](#5-ç›‘æ§å‘Šè­¦é…ç½®)
6. [å¤‡ä»½æ¢å¤ç­–ç•¥](#6-å¤‡ä»½æ¢å¤ç­–ç•¥)
7. [å®¹é‡è§„åˆ’ä¸æ‰©å±•](#7-å®¹é‡è§„åˆ’ä¸æ‰©å±•)
8. [è¿ç»´è‡ªåŠ¨åŒ–è„šæœ¬](#8-è¿ç»´è‡ªåŠ¨åŒ–è„šæœ¬)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ FTPæœåŠ¡é«˜å¯ç”¨éƒ¨ç½²


### 1.1 ä»€ä¹ˆæ˜¯FTPé«˜å¯ç”¨éƒ¨ç½²


**ç®€å•ç†è§£**ï¼šå°±æ˜¯è®©FTPæœåŠ¡æ°¸ä¸å®•æœºï¼Œå³ä½¿æŸå°æœåŠ¡å™¨åäº†ï¼Œç”¨æˆ·è¿˜èƒ½æ­£å¸¸ä¸Šä¼ ä¸‹è½½æ–‡ä»¶ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šé«˜å¯ç”¨ï¼ˆHigh Availabilityï¼ŒHAï¼‰
> 
> æŒ‡ç³»ç»Ÿèƒ½å¤ŸæŒç»­è¿è¡Œï¼Œé¿å…å•ç‚¹æ•…éšœï¼Œé€šå¸¸ç”¨"å‡ ä¸ª9"æ¥è¡¡é‡å¯ç”¨æ€§
> - 99.9% = å¹´åœæœº8.76å°æ—¶
> - 99.99% = å¹´åœæœº52.56åˆ†é’Ÿ

### 1.2 é«˜å¯ç”¨æ¶æ„è®¾è®¡åŸç†


**æ ¸å¿ƒæ€æƒ³**ï¼šæ¶ˆé™¤å•ç‚¹æ•…éšœï¼Œå®ç°å†—ä½™å¤‡ä»½

```
ä¼ ç»Ÿå•æœºéƒ¨ç½²ï¼ˆæœ‰é£é™©ï¼‰ï¼š
ç”¨æˆ· â†’ FTPæœåŠ¡å™¨ â†’ å­˜å‚¨
      ï¼ˆæ•…éšœç‚¹ï¼‰

é«˜å¯ç”¨éƒ¨ç½²ï¼ˆå®‰å…¨ï¼‰ï¼š
     â”Œâ”€ FTPæœåŠ¡å™¨1 â”€â”
ç”¨æˆ· â”€â”¤             â”œâ”€ å…±äº«å­˜å‚¨
     â””â”€ FTPæœåŠ¡å™¨2 â”€â”˜
```

### 1.3 ä¸»æµé«˜å¯ç”¨æ–¹æ¡ˆå¯¹æ¯”


| æ–¹æ¡ˆç±»å‹ | **åŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|---------|-------------|
| ğŸ”„ **ä¸»å¤‡æ¨¡å¼** | `ä¸€ä¸»ä¸€å¤‡ï¼Œæ•…éšœæ—¶åˆ‡æ¢` | `ç®€å•å¯é ` | `èµ„æºåˆ©ç”¨ç‡ä½` | `ä¸­å°å‹ä¼ä¸š` |
| âš–ï¸ **è´Ÿè½½å‡è¡¡** | `å¤šå°æœåŠ¡å™¨åŒæ—¶å·¥ä½œ` | `æ€§èƒ½å¥½ï¼Œåˆ©ç”¨ç‡é«˜` | `å¤æ‚åº¦é«˜` | `å¤§å‹ä¼ä¸š` |
| ğŸŒ **åŒæ´»æ¶æ„** | `ä¸¤åœ°åŒæ—¶æä¾›æœåŠ¡` | `æ€§èƒ½æœ€ä¼˜` | `æˆæœ¬æœ€é«˜` | `å…³é”®ä¸šåŠ¡` |

### 1.4 FTPé«˜å¯ç”¨æ ¸å¿ƒç»„ä»¶


**ğŸ”¸ VIPï¼ˆè™šæ‹ŸIPï¼‰**
```bash
# ä»€ä¹ˆæ˜¯VIPï¼Ÿå°±æ˜¯ä¸€ä¸ª"å‡"çš„IPåœ°å€
# ç”¨æˆ·è®¿é—®è¿™ä¸ªIPï¼Œå®é™…ä¼šè·³è½¬åˆ°çœŸæ­£å·¥ä½œçš„æœåŠ¡å™¨

# é…ç½®ç¤ºä¾‹
ip addr add 192.168.1.100/24 dev eth0  # æ·»åŠ VIP
```

**ğŸ”¸ å¿ƒè·³æ£€æµ‹**
```bash
# æœåŠ¡å™¨ä¹‹é—´äº’ç›¸"æ‰“æ‹›å‘¼"ï¼Œç¡®è®¤å¯¹æ–¹æ˜¯å¦è¿˜æ´»ç€
ping -c 1 192.168.1.10  # æ£€æµ‹æœåŠ¡å™¨1
ping -c 1 192.168.1.11  # æ£€æµ‹æœåŠ¡å™¨2
```

**ğŸ”¸ å…±äº«å­˜å‚¨**
- æ‰€æœ‰FTPæœåŠ¡å™¨è®¿é—®åŒä¸€ä»½æ•°æ®
- ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åœ¨ä»»ä½•æœåŠ¡å™¨éƒ½èƒ½çœ‹åˆ°

---

## 2. âš–ï¸ è´Ÿè½½å‡è¡¡é…ç½®


### 2.1 è´Ÿè½½å‡è¡¡çš„é€šä¿—ç†è§£


**ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒé“¶è¡Œæœ‰å¤šä¸ªçª—å£åŠä¸šåŠ¡ï¼Œé¡¾å®¢æŒ‰è§„åˆ™æ’é˜Ÿåˆ°ä¸åŒçª—å£ï¼Œè¿™æ ·æ•ˆç‡æœ€é«˜ã€‚

```
æ²¡æœ‰è´Ÿè½½å‡è¡¡ï¼š              æœ‰è´Ÿè½½å‡è¡¡ï¼š
ç”¨æˆ· â†’ æœåŠ¡å™¨ï¼ˆå‹åŠ›å¤§ï¼‰      ç”¨æˆ· â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ æœåŠ¡å™¨1
                                            â†’ æœåŠ¡å™¨2
                                            â†’ æœåŠ¡å™¨3
```

### 2.2 FTPè´Ÿè½½å‡è¡¡çš„ç‰¹æ®Šæ€§


**ğŸ”¸ FTPåè®®ç‰¹ç‚¹**
- ä½¿ç”¨åŒç«¯å£ï¼š21ç«¯å£ï¼ˆæ§åˆ¶ï¼‰+ æ•°æ®ç«¯å£
- æœ‰ä¸»åŠ¨æ¨¡å¼å’Œè¢«åŠ¨æ¨¡å¼
- éœ€è¦ä¿æŒä¼šè¯çŠ¶æ€

**âš ï¸ æ³¨æ„äº‹é¡¹**
```
FTPä¸åŒäºHTTPï¼š
âœ… HTTPï¼šæ— çŠ¶æ€ï¼Œä»»æ„æœåŠ¡å™¨éƒ½èƒ½å¤„ç†
âŒ FTPï¼šæœ‰çŠ¶æ€ï¼Œéœ€è¦ä¼šè¯ä¿æŒï¼ˆåŒä¸€ç”¨æˆ·çš„è¯·æ±‚è¦åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼‰
```

### 2.3 å¸¸ç”¨è´Ÿè½½å‡è¡¡æ–¹æ¡ˆ


#### ğŸŒ åŸºäºNginxçš„è´Ÿè½½å‡è¡¡


```nginx
# /etc/nginx/nginx.conf
stream {
    # FTPæ§åˆ¶è¿æ¥è´Ÿè½½å‡è¡¡
    upstream ftp_backend {
        server 192.168.1.10:21 weight=1;
        server 192.168.1.11:21 weight=1;
        
        # ä¼šè¯ä¿æŒï¼ˆé‡è¦ï¼ï¼‰
        ip_hash;
    }
    
    server {
        listen 21;
        proxy_pass ftp_backend;
        proxy_timeout 300s;
        proxy_connect_timeout 5s;
    }
}
```

#### ğŸ”§ åŸºäºLVSçš„4å±‚è´Ÿè½½å‡è¡¡


```bash
# å®‰è£…é…ç½®LVS
yum install -y ipvsadm

# æ·»åŠ è™šæ‹ŸæœåŠ¡
ipvsadm -A -t 192.168.1.100:21 -s rr

# æ·»åŠ çœŸå®æœåŠ¡å™¨
ipvsadm -a -t 192.168.1.100:21 -r 192.168.1.10:21 -m
ipvsadm -a -t 192.168.1.100:21 -r 192.168.1.11:21 -m
```

### 2.4 è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©


| ç®—æ³•åç§° | **å·¥ä½œåŸç†** | **é€‚ç”¨åœºæ™¯** | **FTPé€‚ç”¨æ€§** |
|---------|-------------|-------------|--------------|
| ğŸ”„ **è½®è¯¢ï¼ˆRRï¼‰** | `è¯·æ±‚ä¾æ¬¡åˆ†é…åˆ°å„æœåŠ¡å™¨` | `æœåŠ¡å™¨æ€§èƒ½ç›¸åŒ` | `éœ€é…åˆä¼šè¯ä¿æŒ` |
| ğŸ“Š **åŠ æƒè½®è¯¢ï¼ˆWRRï¼‰** | `æŒ‰æƒé‡æ¯”ä¾‹åˆ†é…è¯·æ±‚` | `æœåŠ¡å™¨æ€§èƒ½ä¸åŒ` | `è¾ƒé€‚ç”¨` |
| ğŸ¯ **IPå“ˆå¸Œ** | `æ ¹æ®å®¢æˆ·ç«¯IPåˆ†é…` | `éœ€è¦ä¼šè¯ä¿æŒ` | `æœ€é€‚åˆFTP` |
| âš¡ **æœ€å°‘è¿æ¥** | `åˆ†é…åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨` | `é•¿è¿æ¥æœåŠ¡` | `é€‚ç”¨ä½†å¤æ‚` |

**ğŸ”¥ æ¨èæ–¹æ¡ˆ**ï¼šIPå“ˆå¸Œ + å¥åº·æ£€æŸ¥

---

## 3. ğŸ’¾ é›†ç¾¤æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆ


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦å…±äº«å­˜å‚¨


**é—®é¢˜åœºæ™¯**ï¼š
```
ç”¨æˆ·Aä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨1 â†’ æ–‡ä»¶å­˜åœ¨æœåŠ¡å™¨1
ç”¨æˆ·Aä¸‹è½½æ–‡ä»¶ï¼Œè´Ÿè½½å‡è¡¡åˆ†é…åˆ°æœåŠ¡å™¨2 â†’ æ‰¾ä¸åˆ°æ–‡ä»¶ï¼
```

**è§£å†³æ–¹æ¡ˆ**ï¼šæ‰€æœ‰FTPæœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„å­˜å‚¨ç©ºé—´

### 3.2 ä¸»æµå­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”


#### ğŸ”¸ NFSï¼ˆNetwork File Systemï¼‰ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ


**ä¼˜ç‚¹**ï¼šé…ç½®ç®€å•ï¼Œæˆæœ¬ä½
**ç¼ºç‚¹**ï¼šå•ç‚¹æ•…éšœï¼Œæ€§èƒ½ä¸€èˆ¬

```bash
# NFSæœåŠ¡å™¨é…ç½®
yum install -y nfs-utils

# é…ç½®å…±äº«ç›®å½•
echo "/data/ftp 192.168.1.0/24(rw,sync,no_root_squash)" >> /etc/exports
systemctl start nfs-server

# FTPæœåŠ¡å™¨æŒ‚è½½
mount -t nfs 192.168.1.100:/data/ftp /var/ftp/
```

#### ğŸ”¸ GlusterFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ


**ä¼˜ç‚¹**ï¼šé«˜å¯ç”¨ï¼Œå¯æ‰©å±•
**ç¼ºç‚¹**ï¼šé…ç½®å¤æ‚

```bash
# å®‰è£…GlusterFS
yum install -y glusterfs-server

# åˆ›å»ºå­˜å‚¨å·
gluster volume create ftp-volume replica 2 \
  server1:/data/ftp server2:/data/ftp

# å¯åŠ¨å·
gluster volume start ftp-volume
```

#### ğŸ”¸ Cephåˆ†å¸ƒå¼å­˜å‚¨


**ä¼˜ç‚¹**ï¼šä¼ä¸šçº§ï¼ŒåŠŸèƒ½å¼ºå¤§
**ç¼ºç‚¹**ï¼šå­¦ä¹ æˆæœ¬é«˜ï¼Œèµ„æºå ç”¨å¤§

### 3.3 å­˜å‚¨æ–¹æ¡ˆé€‰æ‹©å»ºè®®


```
ğŸ’¡ é€‰æ‹©æŒ‡å—ï¼š

å°å‹ä¼ä¸šï¼ˆ<100ç”¨æˆ·ï¼‰ï¼š
â†’ NFS + å®šæœŸå¤‡ä»½
â†’ ç®€å•å¤Ÿç”¨ï¼Œæˆæœ¬å¯æ§

ä¸­å‹ä¼ä¸šï¼ˆ100-1000ç”¨æˆ·ï¼‰ï¼š
â†’ GlusterFSåŒå‰¯æœ¬
â†’ å¹³è¡¡æ€§èƒ½ä¸å¯é æ€§

å¤§å‹ä¼ä¸šï¼ˆ>1000ç”¨æˆ·ï¼‰ï¼š
â†’ Cephå­˜å‚¨é›†ç¾¤
â†’ ä¸“ä¸šè¿ç»´å›¢é˜Ÿç»´æŠ¤
```

### 3.4 å­˜å‚¨ä¼˜åŒ–é…ç½®


**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–**
```bash
# è°ƒæ•´NFSç¼“å­˜
echo 'rsize=32768,wsize=32768' >> /etc/fstab

# è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿ
mount -o noatime,nodiratime /dev/sdb1 /data/ftp
```

**ğŸ”¸ å®‰å…¨é…ç½®**
```bash
# é™åˆ¶è®¿é—®æƒé™
chmod 755 /data/ftp
chown ftp:ftp /data/ftp

# é…ç½®é˜²ç«å¢™
firewall-cmd --add-service=nfs --permanent
firewall-cmd --reload
```

---

## 4. ğŸ”„ è‡ªåŠ¨æ•…éšœåˆ‡æ¢


### 4.1 æ•…éšœåˆ‡æ¢çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ•…éšœåˆ‡æ¢**ï¼šå½“ä¸»æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨æŠŠæœåŠ¡åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨ï¼Œç”¨æˆ·æ„Ÿè§‰ä¸åˆ°ä¸­æ–­ã€‚

```
æ­£å¸¸æƒ…å†µï¼š
ç”¨æˆ· â†’ VIP(192.168.1.100) â†’ ä¸»æœåŠ¡å™¨(192.168.1.10)

æ•…éšœå‘ç”Ÿï¼š
ç”¨æˆ· â†’ VIP(192.168.1.100) â†’ å¤‡æœåŠ¡å™¨(192.168.1.11)
                              (è‡ªåŠ¨åˆ‡æ¢ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥)
```

### 4.2 Keepalivedå®ç°è‡ªåŠ¨åˆ‡æ¢


#### ğŸ”¸ Keepalivedå·¥ä½œåŸç†


**æ ¸å¿ƒæœºåˆ¶**ï¼š
- â­ **VRRPåè®®**ï¼šè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®
- â­ **ä¼˜å…ˆçº§æœºåˆ¶**ï¼šæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜
- â­ **å¿ƒè·³æ£€æµ‹**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€

#### ğŸ”¸ ä¸»æœåŠ¡å™¨é…ç½®


```bash
# /etc/keepalived/keepalived.conf
vrrp_instance VI_1 {
    state MASTER              # ä¸»æœåŠ¡å™¨
    interface eth0            # ç½‘ç»œæ¥å£
    virtual_router_id 51      # è·¯ç”±IDï¼ˆé›†ç¾¤å†…å”¯ä¸€ï¼‰
    priority 150              # ä¼˜å…ˆçº§ï¼ˆä¸»>å¤‡ï¼‰
    advert_int 1              # å¿ƒè·³é—´éš”1ç§’
    
    authentication {
        auth_type PASS
        auth_pass 1234
    }
    
    virtual_ipaddress {
        192.168.1.100/24       # VIPåœ°å€
    }
    
    # å¥åº·æ£€æŸ¥è„šæœ¬
    track_script {
        check_ftp
    }
}

# FTPæœåŠ¡æ£€æŸ¥è„šæœ¬
vrrp_script check_ftp {
    script "/etc/keepalived/check_ftp.sh"
    interval 3                 # æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡
    weight -20                 # æ£€æŸ¥å¤±è´¥é™ä½20ä¼˜å…ˆçº§
}
```

#### ğŸ”¸ å¤‡æœåŠ¡å™¨é…ç½®


```bash
# å¤‡æœåŠ¡å™¨é…ç½®ï¼ˆåªæ”¹è¿™å‡ é¡¹ï¼‰
vrrp_instance VI_1 {
    state BACKUP              # å¤‡æœåŠ¡å™¨
    priority 100              # ä¼˜å…ˆçº§ä½äºä¸»æœåŠ¡å™¨
    # å…¶ä»–é…ç½®ç›¸åŒ...
}
```

#### ğŸ”¸ å¥åº·æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# /etc/keepalived/check_ftp.sh

# æ£€æŸ¥FTPæœåŠ¡æ˜¯å¦è¿è¡Œ
systemctl is-active vsftpd >/dev/null 2>&1

if [ $? -ne 0 ]; then
    # å°è¯•é‡å¯æœåŠ¡
    systemctl restart vsftpd
    sleep 2
    
    # å†æ¬¡æ£€æŸ¥
    systemctl is-active vsftpd >/dev/null 2>&1
    if [ $? -ne 0 ]; then
        exit 1  # æ£€æŸ¥å¤±è´¥
    fi
fi

# æ£€æŸ¥FTPç«¯å£æ˜¯å¦å¯è¾¾
nc -z localhost 21 >/dev/null 2>&1
exit $?
```

### 4.3 åˆ‡æ¢è¿‡ç¨‹è¯¦è§£


```
æ•…éšœåˆ‡æ¢æ—¶åºå›¾ï¼š

ä¸»æœåŠ¡å™¨    å¤‡æœåŠ¡å™¨    ç”¨æˆ·
    |          |        |
    |---å¿ƒè·³--->|        |
    |<--å¿ƒè·³----|        |
    |          |        |
   [æ•…éšœ]      |        |
    X          |        |
    |          |        |
    |      [æ£€æµ‹è¶…æ—¶]    |
    |          |        |
    |      [æ¥ç®¡VIP]    |
    |          |------->|  ç»§ç»­æœåŠ¡
    |          |<-------|  
```

### 4.4 æ•…éšœåˆ‡æ¢ä¼˜åŒ–


**ğŸ”¸ è„‘è£‚é—®é¢˜é˜²æŠ¤**
```bash
# ä½¿ç”¨å¤šç§æ£€æµ‹æ–¹å¼
vrrp_instance VI_1 {
    # ...å…¶ä»–é…ç½®
    
    # å¤šç½‘å¡æ£€æµ‹
    track_interface {
        eth0
        eth1
    }
    
    # ç½‘ç»œè¿é€šæ€§æ£€æµ‹
    track_script {
        check_network
        check_ftp
    }
}
```

**ğŸ”¸ åˆ‡æ¢ç­–ç•¥ä¼˜åŒ–**
```bash
# å»¶è¿ŸæŠ¢å ï¼Œé¿å…é¢‘ç¹åˆ‡æ¢
vrrp_instance VI_1 {
    # ...
    nopreempt                  # ä¸ä¸»åŠ¨æŠ¢å 
    preempt_delay 60          # å»¶è¿Ÿ60ç§’æŠ¢å 
}
```

---

## 5. ğŸ“Š ç›‘æ§å‘Šè­¦é…ç½®


### 5.1 ç›‘æ§å‘Šè­¦çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§**ï¼š
- âœ… æå‰å‘ç°é—®é¢˜ï¼Œé¿å…æ•…éšœ
- âœ… äº†è§£æœåŠ¡è´Ÿè½½ï¼Œåˆç†æ‰©å®¹
- âœ… åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–ä½“éªŒ
- âœ… æ»¡è¶³è¿ç»´åˆè§„è¦æ±‚

### 5.2 ç›‘æ§æŒ‡æ ‡ä½“ç³»


#### ğŸ”¸ ç³»ç»Ÿçº§ç›‘æ§


| ç›‘æ§é¡¹ç›® | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** | **æ£€æŸ¥æ–¹æ³•** |
|---------|-------------|-------------|-------------|
| ğŸ–¥ï¸ **CPUä½¿ç”¨ç‡** | `< 70%` | `> 80%` | `top`, `htop` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨ç‡** | `< 80%` | `> 90%` | `free -m` |
| ğŸ’¿ **ç£ç›˜ä½¿ç”¨ç‡** | `< 85%` | `> 90%` | `df -h` |
| ğŸŒ **ç½‘ç»œå¸¦å®½** | `< 80%å³°å€¼` | `> 90%å³°å€¼` | `iftop`, `nethogs` |
| ğŸ”Œ **è¿æ¥æ•°** | `< 1000` | `> 1500` | `netstat -an` |

#### ğŸ”¸ FTPæœåŠ¡çº§ç›‘æ§


```bash
# æ£€æŸ¥FTPæœåŠ¡çŠ¶æ€
systemctl status vsftpd

# æ£€æŸ¥FTPç«¯å£ç›‘å¬
netstat -tlnp | grep :21

# ç»Ÿè®¡å½“å‰FTPè¿æ¥æ•°
netstat -an | grep :21 | grep ESTABLISHED | wc -l

# æŸ¥çœ‹FTPæ—¥å¿—
tail -f /var/log/vsftpd.log
```

### 5.3 Zabbixç›‘æ§é…ç½®


#### ğŸ”¸ å®‰è£…é…ç½®Zabbix Agent


```bash
# å®‰è£…agent
yum install -y zabbix-agent

# é…ç½®æ–‡ä»¶
# /etc/zabbix/zabbix_agentd.conf
Server=192.168.1.200          # ZabbixæœåŠ¡å™¨IP
ServerActive=192.168.1.200
Hostname=ftp-server-01        # ä¸»æœºå
```

#### ğŸ”¸ è‡ªå®šä¹‰ç›‘æ§è„šæœ¬


```bash
#!/bin/bash
# /etc/zabbix/scripts/ftp_monitor.sh

case $1 in
    "connections")
        # ç»Ÿè®¡FTPè¿æ¥æ•°
        netstat -an | grep :21 | grep ESTABLISHED | wc -l
        ;;
    "upload_speed")
        # ç»Ÿè®¡ä¸Šä¼ é€Ÿåº¦ï¼ˆä»æ—¥å¿—åˆ†æï¼‰
        awk '/UPLOAD/ {sum += $NF} END {print sum/NR}' /var/log/vsftpd.log
        ;;
    "disk_usage")
        # FTPç›®å½•ä½¿ç”¨é‡
        du -s /var/ftp/ | awk '{print $1}'
        ;;
esac
```

### 5.4 å‘Šè­¦é€šçŸ¥é…ç½®


#### ğŸ”¸ é‚®ä»¶å‘Šè­¦


```bash
# å®‰è£…mailx
yum install -y mailx

# å‘Šè­¦è„šæœ¬
#!/bin/bash
# /etc/zabbix/scripts/alert.sh
SUBJECT="FTPæœåŠ¡å‘Šè­¦"
MESSAGE="$1"
EMAIL="admin@company.com"

echo "$MESSAGE" | mail -s "$SUBJECT" "$EMAIL"
```

#### ğŸ”¸ å¾®ä¿¡/é’‰é’‰å‘Šè­¦


```bash
#!/bin/bash
# é’‰é’‰æœºå™¨äººå‘Šè­¦
WEBHOOK_URL="https://oapi.dingtalk.com/robot/send?access_token=xxx"

curl -H "Content-Type: application/json" \
     -X POST \
     -d '{
         "msgtype": "text",
         "text": {
             "content": "FTPæœåŠ¡å‘Šè­¦ï¼š'$1'"
         }
     }' \
     $WEBHOOK_URL
```

### 5.5 å‘Šè­¦ç­–ç•¥è®¾ç½®


**ğŸ”¸ å‘Šè­¦çº§åˆ«å®šä¹‰**
```
ğŸ”´ ç´§æ€¥ï¼ˆP1ï¼‰ï¼šæœåŠ¡ä¸å¯ç”¨
  â†’ ç«‹å³çŸ­ä¿¡+ç”µè¯é€šçŸ¥
  â†’ 5åˆ†é’Ÿå†…å“åº”

ğŸŸ¡ é‡è¦ï¼ˆP2ï¼‰ï¼šæ€§èƒ½ä¸‹é™
  â†’ é‚®ä»¶+å¾®ä¿¡é€šçŸ¥
  â†’ 30åˆ†é’Ÿå†…å“åº”

ğŸ”µ ä¸€èˆ¬ï¼ˆP3ï¼‰ï¼šèµ„æºé¢„è­¦
  â†’ é‚®ä»¶é€šçŸ¥
  â†’ å·¥ä½œæ—¶é—´å¤„ç†
```

---

## 6. ğŸ’¾ å¤‡ä»½æ¢å¤ç­–ç•¥


### 6.1 å¤‡ä»½çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å¤‡ä»½**ï¼šå°±æ˜¯æŠŠé‡è¦æ•°æ®å¤åˆ¶ä¸€ä»½å­˜åˆ°å®‰å…¨çš„åœ°æ–¹ï¼Œé˜²æ­¢åŸå§‹æ•°æ®ä¸¢å¤±ã€‚

**å¤‡ä»½çš„é‡è¦æ€§**ï¼š
- ğŸ”¥ ç¡¬ä»¶æ•…éšœï¼šç¡¬ç›˜åäº†
- ğŸ”¥ äººä¸ºè¯¯æ“ä½œï¼šåˆ é”™æ–‡ä»¶
- ğŸ”¥ ç—…æ¯’æ”»å‡»ï¼šå‹’ç´¢è½¯ä»¶
- ğŸ”¥ è‡ªç„¶ç¾å®³ï¼šç«ç¾ã€åœ°éœ‡

### 6.2 å¤‡ä»½ç­–ç•¥è®¾è®¡


#### ğŸ”¸ å¤‡ä»½ç±»å‹å¯¹æ¯”


| å¤‡ä»½ç±»å‹ | **å¤‡ä»½å†…å®¹** | **é€Ÿåº¦** | **ç©ºé—´å ç”¨** | **æ¢å¤é€Ÿåº¦** |
|---------|-------------|---------|-------------|-------------|
| ğŸ“¦ **å®Œå…¨å¤‡ä»½** | `æ‰€æœ‰æ•°æ®` | `æ…¢` | `å¤§` | `å¿«` |
| ğŸ”„ **å¢é‡å¤‡ä»½** | `ä¸Šæ¬¡å¤‡ä»½åçš„å˜åŒ–` | `å¿«` | `å°` | `æ…¢ï¼ˆéœ€å¤šæ¬¡æ¢å¤ï¼‰` |
| ğŸ“ˆ **å·®å¼‚å¤‡ä»½** | `ä¸Šæ¬¡å®Œå…¨å¤‡ä»½åçš„å˜åŒ–` | `ä¸­ç­‰` | `ä¸­ç­‰` | `ä¸­ç­‰` |

#### ğŸ”¸ 3-2-1å¤‡ä»½åŸåˆ™


```
ğŸ’¡ ä¸šç•Œé‡‘æ ‡å‡†ï¼š
3 - è‡³å°‘3ä»½æ•°æ®å‰¯æœ¬
2 - å­˜å‚¨åœ¨2ç§ä¸åŒä»‹è´¨ä¸Š  
1 - è‡³å°‘1ä»½å¼‚åœ°å¤‡ä»½

å®é™…åº”ç”¨ï¼š
ç”Ÿäº§æ•°æ®ï¼ˆ1ä»½ï¼‰ + æœ¬åœ°å¤‡ä»½ï¼ˆ1ä»½ï¼‰ + å¼‚åœ°å¤‡ä»½ï¼ˆ1ä»½ï¼‰
```

### 6.3 è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬


#### ğŸ”¸ å®Œå…¨å¤‡ä»½è„šæœ¬


```bash
#!/bin/bash
# /opt/scripts/ftp_backup.sh

# é…ç½®ä¿¡æ¯
BACKUP_SOURCE="/var/ftp"
BACKUP_DEST="/backup/ftp"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="ftp_backup_$DATE.tar.gz"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DEST

# æ‰§è¡Œå¤‡ä»½
echo "å¼€å§‹å¤‡ä»½ FTP æ•°æ®..."
tar -czf $BACKUP_DEST/$BACKUP_FILE $BACKUP_SOURCE

# æ£€æŸ¥å¤‡ä»½ç»“æœ
if [ $? -eq 0 ]; then
    echo "å¤‡ä»½æˆåŠŸï¼š$BACKUP_FILE"
    
    # è®°å½•å¤‡ä»½æ—¥å¿—
    echo "$(date): å¤‡ä»½æˆåŠŸ - $BACKUP_FILE" >> /var/log/ftp_backup.log
    
    # åˆ é™¤7å¤©å‰çš„å¤‡ä»½
    find $BACKUP_DEST -name "ftp_backup_*.tar.gz" -mtime +7 -delete
else
    echo "å¤‡ä»½å¤±è´¥ï¼"
    echo "$(date): å¤‡ä»½å¤±è´¥" >> /var/log/ftp_backup.log
fi
```

#### ğŸ”¸ å¢é‡å¤‡ä»½è„šæœ¬


```bash
#!/bin/bash
# å¢é‡å¤‡ä»½ï¼ˆåŸºäºrsyncï¼‰

SOURCE="/var/ftp"
DEST="/backup/incremental"
DATE=$(date +%Y%m%d)

# åˆ›å»ºä»Šå¤©çš„å¤‡ä»½ç›®å½•
mkdir -p $DEST/$DATE

# å¢é‡åŒæ­¥
rsync -av --delete --link-dest=$DEST/latest $SOURCE/ $DEST/$DATE/

# æ›´æ–°æœ€æ–°å¤‡ä»½é“¾æ¥
rm -f $DEST/latest
ln -s $DATE $DEST/latest

echo "å¢é‡å¤‡ä»½å®Œæˆï¼š$DEST/$DATE"
```

### 6.4 å®šæ—¶å¤‡ä»½é…ç½®


```bash
# é…ç½®crontabå®šæ—¶ä»»åŠ¡
crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå®Œå…¨å¤‡ä»½
0 2 * * * /opt/scripts/ftp_backup.sh

# æ¯4å°æ—¶æ‰§è¡Œå¢é‡å¤‡ä»½
0 */4 * * * /opt/scripts/incremental_backup.sh

# æ¯å‘¨æ—¥æ‰§è¡Œå®Œå…¨å¤‡ä»½å¹¶ä¸Šä¼ åˆ°å¼‚åœ°
0 3 * * 0 /opt/scripts/full_backup_and_upload.sh
```

### 6.5 å¼‚åœ°å¤‡ä»½æ–¹æ¡ˆ


#### ğŸ”¸ äº‘å­˜å‚¨å¤‡ä»½


```bash
#!/bin/bash
# ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSS

# å®‰è£…ossutilå·¥å…·
wget http://gosspublic.alicdn.com/ossutil/1.7.0/ossutil64
chmod +x ossutil64

# é…ç½®OSS
./ossutil64 config -e oss-cn-hangzhou.aliyuncs.com \
                   -i your-access-key-id \
                   -k your-access-key-secret

# ä¸Šä¼ å¤‡ä»½æ–‡ä»¶
./ossutil64 cp /backup/ftp/ftp_backup_*.tar.gz \
             oss://your-bucket/ftp-backup/
```

### 6.6 æ¢å¤æµ‹è¯•æµç¨‹


```bash
#!/bin/bash
# å¤‡ä»½æ¢å¤æµ‹è¯•è„šæœ¬

echo "=== FTPå¤‡ä»½æ¢å¤æµ‹è¯• ==="

# 1. åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
TEST_DIR="/tmp/ftp_restore_test"
mkdir -p $TEST_DIR

# 2. è§£å‹å¤‡ä»½æ–‡ä»¶
BACKUP_FILE="/backup/ftp/ftp_backup_20231201_020000.tar.gz"
tar -xzf $BACKUP_FILE -C $TEST_DIR

# 3. éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
echo "éªŒè¯å¤‡ä»½æ–‡ä»¶..."
find $TEST_DIR -type f -exec md5sum {} \; > /tmp/backup_md5.txt

# 4. ç”Ÿæˆæ¢å¤æŠ¥å‘Š
echo "æ¢å¤æµ‹è¯•å®Œæˆ"
echo "å¤‡ä»½æ–‡ä»¶ï¼š$BACKUP_FILE"
echo "æ–‡ä»¶æ•°é‡ï¼š$(find $TEST_DIR -type f | wc -l)"
echo "æ€»å¤§å°ï¼š$(du -sh $TEST_DIR | awk '{print $1}')"

# 5. æ¸…ç†æµ‹è¯•ç¯å¢ƒ
rm -rf $TEST_DIR
```

---

## 7. ğŸ“ˆ å®¹é‡è§„åˆ’ä¸æ‰©å±•


### 7.1 å®¹é‡è§„åˆ’çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆè¦åšå®¹é‡è§„åˆ’**ï¼š
- ğŸ¯ é¿å…æ€§èƒ½ç“¶é¢ˆ
- ğŸ¯ æ§åˆ¶æˆæœ¬é¢„ç®—
- ğŸ¯ ä¿è¯æœåŠ¡è´¨é‡
- ğŸ¯ æ”¯æ’‘ä¸šåŠ¡å¢é•¿

### 7.2 å®¹é‡è¯„ä¼°æ–¹æ³•


#### ğŸ”¸ ç”¨æˆ·å¢é•¿é¢„æµ‹


```
ä¸šåŠ¡æŒ‡æ ‡æ”¶é›†ï¼š
â€¢ å½“å‰ç”¨æˆ·æ•°ï¼š1000äºº
â€¢ æœˆå¢é•¿ç‡ï¼š20%
â€¢ å¹³å‡æ–‡ä»¶å¤§å°ï¼š10MB
â€¢ æ¯ç”¨æˆ·æ—¥ä¼ è¾“é‡ï¼š100MB

è®¡ç®—å…¬å¼ï¼š
æœªæ¥ç”¨æˆ·æ•° = å½“å‰ç”¨æˆ·æ•° Ã— (1 + æœˆå¢é•¿ç‡)^æœˆæ•°
å­˜å‚¨éœ€æ±‚ = ç”¨æˆ·æ•° Ã— å¹³å‡æ–‡ä»¶å¤§å° Ã— æ–‡ä»¶ä¿å­˜å‘¨æœŸ
å¸¦å®½éœ€æ±‚ = ç”¨æˆ·æ•° Ã— æ—¥ä¼ è¾“é‡ / å·¥ä½œæ—¶é•¿
```

#### ğŸ”¸ èµ„æºä½¿ç”¨è¶‹åŠ¿åˆ†æ


```bash
#!/bin/bash
# èµ„æºä½¿ç”¨ç»Ÿè®¡è„šæœ¬

echo "=== FTPæœåŠ¡å™¨èµ„æºä½¿ç”¨æŠ¥å‘Š ==="
echo "ç”Ÿæˆæ—¶é—´ï¼š$(date)"
echo ""

# CPUä½¿ç”¨ç‡
echo "CPUä½¿ç”¨ç‡ï¼š"
top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1

# å†…å­˜ä½¿ç”¨æƒ…å†µ
echo "å†…å­˜ä½¿ç”¨æƒ…å†µï¼š"
free -h | grep "Mem:"

# ç£ç›˜ä½¿ç”¨æƒ…å†µ
echo "ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
df -h /var/ftp

# FTPè¿æ¥æ•°ç»Ÿè®¡
echo "FTPè¿æ¥æ•°ï¼š"
netstat -an | grep :21 | grep ESTABLISHED | wc -l

# ç½‘ç»œæµé‡ç»Ÿè®¡
echo "ç½‘ç»œæµé‡ï¼ˆæœ€è¿‘1å°æ—¶ï¼‰ï¼š"
sar -n DEV 1 3600 | grep eth0 | tail -1
```

### 7.3 æ€§èƒ½ç“¶é¢ˆè¯†åˆ«


#### ğŸ”¸ å¸¸è§æ€§èƒ½ç“¶é¢ˆ


| ç“¶é¢ˆç±»å‹ | **ç—‡çŠ¶è¡¨ç°** | **æ’æŸ¥æ–¹æ³•** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|-------------|
| ğŸ–¥ï¸ **CPUç“¶é¢ˆ** | `ç³»ç»Ÿå“åº”æ…¢ï¼Œloadé«˜` | `top`, `htop` | `å¢åŠ CPUæ ¸å¿ƒæˆ–ä¼˜åŒ–ç¨‹åº` |
| ğŸ’¾ **å†…å­˜ç“¶é¢ˆ** | `é¢‘ç¹ä½¿ç”¨swap` | `free -m`, `vmstat` | `å¢åŠ å†…å­˜æˆ–ä¼˜åŒ–ç¼“å­˜` |
| ğŸ’¿ **ç£ç›˜IOç“¶é¢ˆ** | `æ–‡ä»¶ä¼ è¾“æ…¢` | `iostat`, `iotop` | `ä½¿ç”¨SSDæˆ–ä¼˜åŒ–å­˜å‚¨` |
| ğŸŒ **ç½‘ç»œç“¶é¢ˆ** | `å¸¦å®½å æ»¡` | `iftop`, `nethogs` | `å‡çº§ç½‘ç»œæˆ–ä¼˜åŒ–ä¼ è¾“` |

#### ğŸ”¸ æ€§èƒ½ç›‘æ§è„šæœ¬


```bash
#!/bin/bash
# æ€§èƒ½ç“¶é¢ˆæ£€æµ‹è„šæœ¬

check_cpu() {
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    if (( $(echo "$CPU_USAGE > 80" | bc -l) )); then
        echo "âš ï¸ CPUä½¿ç”¨ç‡è¿‡é«˜ï¼š$CPU_USAGE%"
    fi
}

check_memory() {
    MEM_USAGE=$(free | awk 'NR==2{printf "%.2f", $3*100/$2}')
    if (( $(echo "$MEM_USAGE > 85" | bc -l) )); then
        echo "âš ï¸ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼š$MEM_USAGE%"
    fi
}

check_disk() {
    DISK_USAGE=$(df /var/ftp | awk 'NR==2 {print $5}' | cut -d'%' -f1)
    if [ $DISK_USAGE -gt 85 ]; then
        echo "âš ï¸ ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜ï¼š$DISK_USAGE%"
    fi
}

# æ‰§è¡Œæ£€æŸ¥
check_cpu
check_memory  
check_disk
```

### 7.4 æ‰©å±•æ–¹æ¡ˆè®¾è®¡


#### ğŸ”¸ å‚ç›´æ‰©å±•ï¼ˆScale Upï¼‰


**é€‚ç”¨åœºæ™¯**ï¼šä¸­å°è§„æ¨¡ï¼Œèµ„æºä¸è¶³
```bash
# å¢åŠ ç¡¬ä»¶èµ„æº
# CPUï¼š2æ ¸ â†’ 4æ ¸
# å†…å­˜ï¼š4GB â†’ 8GB  
# ç£ç›˜ï¼š500GB â†’ 1TB

# ä¼˜åŒ–ç³»ç»Ÿé…ç½®
echo 'net.core.somaxconn = 65535' >> /etc/sysctl.conf
echo 'fs.file-max = 100000' >> /etc/sysctl.conf
sysctl -p
```

#### ğŸ”¸ æ°´å¹³æ‰©å±•ï¼ˆScale Outï¼‰


**é€‚ç”¨åœºæ™¯**ï¼šå¤§è§„æ¨¡ï¼Œéœ€è¦é«˜å¯ç”¨
```
æ‰©å±•æ¶æ„ï¼š

è´Ÿè½½å‡è¡¡å™¨
    |
    â”œâ”€â”€ FTPæœåŠ¡å™¨1
    â”œâ”€â”€ FTPæœåŠ¡å™¨2  
    â”œâ”€â”€ FTPæœåŠ¡å™¨3ï¼ˆæ–°å¢ï¼‰
    â””â”€â”€ FTPæœåŠ¡å™¨4ï¼ˆæ–°å¢ï¼‰
    |
å…±äº«å­˜å‚¨é›†ç¾¤
```

### 7.5 è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹æ¡ˆ


```bash
#!/bin/bash
# è‡ªåŠ¨æ‰©å®¹è„šæœ¬ï¼ˆåŸºäºDockerï¼‰

# ç›‘æ§æŒ‡æ ‡
CPU_THRESHOLD=80
MEMORY_THRESHOLD=85
CONNECTION_THRESHOLD=500

# è·å–å½“å‰è´Ÿè½½
get_load() {
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    MEM_USAGE=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
    CONNECTIONS=$(netstat -an | grep :21 | grep ESTABLISHED | wc -l)
}

# æ‰©å®¹å†³ç­–
scale_out() {
    if [ $CPU_USAGE -gt $CPU_THRESHOLD ] || 
       [ $MEM_USAGE -gt $MEMORY_THRESHOLD ] || 
       [ $CONNECTIONS -gt $CONNECTION_THRESHOLD ]; then
        
        echo "è§¦å‘æ‰©å®¹æ¡ä»¶ï¼Œå¯åŠ¨æ–°FTPå®¹å™¨..."
        docker run -d --name ftp-$(date +%s) \
                   -p 0:21 \
                   -v /shared/ftp:/var/ftp \
                   ftp-server:latest
        
        # æ³¨å†Œåˆ°è´Ÿè½½å‡è¡¡
        # ...
    fi
}

# æ‰§è¡Œæ‰©å®¹æ£€æŸ¥
get_load
scale_out
```

---

## 8. ğŸ¤– è¿ç»´è‡ªåŠ¨åŒ–è„šæœ¬


### 8.1 è¿ç»´è‡ªåŠ¨åŒ–çš„ä»·å€¼


**ä¸ºä»€ä¹ˆè¦è‡ªåŠ¨åŒ–**ï¼š
- âš¡ å‡å°‘äººå·¥æ“ä½œé”™è¯¯
- âš¡ æé«˜è¿ç»´æ•ˆç‡
- âš¡ ä¿è¯æ“ä½œæ ‡å‡†åŒ–
- âš¡ æ”¯æŒ7Ã—24å°æ—¶è¿ç»´

### 8.2 æ—¥å¸¸è¿ç»´è„šæœ¬é›†åˆ


#### ğŸ”¸ æœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# /opt/scripts/ftp_health_check.sh

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}=== FTPæœåŠ¡å¥åº·æ£€æŸ¥ ===${NC}"
echo "æ£€æŸ¥æ—¶é—´ï¼š$(date)"
echo ""

# 1. æ£€æŸ¥FTPæœåŠ¡çŠ¶æ€
check_service() {
    if systemctl is-active vsftpd >/dev/null 2>&1; then
        echo -e "âœ… FTPæœåŠ¡çŠ¶æ€ï¼š${GREEN}è¿è¡Œä¸­${NC}"
    else
        echo -e "âŒ FTPæœåŠ¡çŠ¶æ€ï¼š${RED}å·²åœæ­¢${NC}"
        return 1
    fi
}

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
check_port() {
    if netstat -tlnp | grep :21 >/dev/null 2>&1; then
        echo -e "âœ… ç«¯å£ç›‘å¬ï¼š${GREEN}æ­£å¸¸${NC}"
    else
        echo -e "âŒ ç«¯å£ç›‘å¬ï¼š${RED}å¼‚å¸¸${NC}"
        return 1
    fi
}

# 3. æ£€æŸ¥è¿æ¥æ•°
check_connections() {
    CONN_COUNT=$(netstat -an | grep :21 | grep ESTABLISHED | wc -l)
    if [ $CONN_COUNT -lt 100 ]; then
        echo -e "âœ… å½“å‰è¿æ¥æ•°ï¼š${GREEN}$CONN_COUNT${NC}"
    else
        echo -e "âš ï¸  å½“å‰è¿æ¥æ•°ï¼š${YELLOW}$CONN_COUNT${NC} (å»ºè®®å…³æ³¨)"
    fi
}

# 4. æ£€æŸ¥ç£ç›˜ç©ºé—´
check_disk_space() {
    DISK_USAGE=$(df /var/ftp | awk 'NR==2 {print $5}' | cut -d'%' -f1)
    if [ $DISK_USAGE -lt 80 ]; then
        echo -e "âœ… ç£ç›˜ä½¿ç”¨ç‡ï¼š${GREEN}$DISK_USAGE%${NC}"
    elif [ $DISK_USAGE -lt 90 ]; then
        echo -e "âš ï¸  ç£ç›˜ä½¿ç”¨ç‡ï¼š${YELLOW}$DISK_USAGE%${NC}"
    else
        echo -e "âŒ ç£ç›˜ä½¿ç”¨ç‡ï¼š${RED}$DISK_USAGE%${NC}"
    fi
}

# æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥
check_service
check_port
check_connections
check_disk_space

echo ""
echo -e "${GREEN}å¥åº·æ£€æŸ¥å®Œæˆ${NC}"
```

#### ğŸ”¸ æ—¥å¿—åˆ†æè„šæœ¬


```bash
#!/bin/bash
# FTPæ—¥å¿—åˆ†æè„šæœ¬

LOG_FILE="/var/log/vsftpd.log"
TODAY=$(date +%Y%m%d)

echo "=== FTPæ—¥å¿—åˆ†ææŠ¥å‘Š ==="
echo "åˆ†ææ—¥æœŸï¼š$(date)"
echo ""

# 1. ç™»å½•ç»Ÿè®¡
echo "ğŸ“Š ç”¨æˆ·ç™»å½•ç»Ÿè®¡ï¼š"
grep "OK LOGIN" $LOG_FILE | grep $TODAY | \
awk '{print $6}' | sort | uniq -c | sort -nr | head -10

# 2. ä¸Šä¼ ç»Ÿè®¡  
echo ""
echo "ğŸ“¤ æ–‡ä»¶ä¸Šä¼ ç»Ÿè®¡ï¼š"
grep "OK UPLOAD" $LOG_FILE | grep $TODAY | wc -l | \
awk '{print "ä»Šæ—¥ä¸Šä¼ æ–‡ä»¶æ•°ï¼š"$1}'

# 3. ä¸‹è½½ç»Ÿè®¡
echo ""
echo "ğŸ“¥ æ–‡ä»¶ä¸‹è½½ç»Ÿè®¡ï¼š"
grep "OK DOWNLOAD" $LOG_FILE | grep $TODAY | wc -l | \
awk '{print "ä»Šæ—¥ä¸‹è½½æ–‡ä»¶æ•°ï¼š"$1}'

# 4. é”™è¯¯ç»Ÿè®¡
echo ""
echo "âŒ é”™è¯¯ç»Ÿè®¡ï¼š"
grep "FAIL" $LOG_FILE | grep $TODAY | \
awk '{print $5}' | sort | uniq -c | sort -nr

# 5. æµé‡ç»Ÿè®¡
echo ""
echo "ğŸŒ æµé‡ç»Ÿè®¡ï¼š"
UPLOAD_BYTES=$(grep "OK UPLOAD" $LOG_FILE | grep $TODAY | \
               awk '{sum+=$NF} END {print sum}')
DOWNLOAD_BYTES=$(grep "OK DOWNLOAD" $LOG_FILE | grep $TODAY | \
                 awk '{sum+=$NF} END {print sum}')

echo "ä¸Šä¼ æµé‡ï¼š$(echo $UPLOAD_BYTES | awk '{printf "%.2f MB", $1/1024/1024}')"
echo "ä¸‹è½½æµé‡ï¼š$(echo $DOWNLOAD_BYTES | awk '{printf "%.2f MB", $1/1024/1024}')"
```

#### ğŸ”¸ ç”¨æˆ·ç®¡ç†è„šæœ¬


```bash
#!/bin/bash
# FTPç”¨æˆ·ç®¡ç†è„šæœ¬

FTP_USER_FILE="/etc/vsftpd/virtual_users.txt"
FTP_USER_DB="/etc/vsftpd/virtual_users.db"

# æ·»åŠ ç”¨æˆ·
add_user() {
    local username=$1
    local password=$2
    
    if [ -z "$username" ] || [ -z "$password" ]; then
        echo "ç”¨æ³•: $0 add <username> <password>"
        exit 1
    fi
    
    # æ·»åŠ åˆ°ç”¨æˆ·æ–‡ä»¶
    echo "$username" >> $FTP_USER_FILE
    echo "$password" >> $FTP_USER_FILE
    
    # é‡æ–°ç”Ÿæˆæ•°æ®åº“
    db_load -T -t hash -f $FTP_USER_FILE $FTP_USER_DB
    chmod 600 $FTP_USER_DB
    
    # åˆ›å»ºç”¨æˆ·ç›®å½•
    mkdir -p /var/ftp/users/$username
    chown ftp:ftp /var/ftp/users/$username
    
    echo "ç”¨æˆ· $username æ·»åŠ æˆåŠŸ"
}

# åˆ é™¤ç”¨æˆ·
del_user() {
    local username=$1
    
    if [ -z "$username" ]; then
        echo "ç”¨æ³•: $0 del <username>"
        exit 1
    fi
    
    # ä»ç”¨æˆ·æ–‡ä»¶ä¸­åˆ é™¤ï¼ˆåˆ é™¤ç”¨æˆ·ååŠå…¶å¯†ç ï¼‰
    sed -i "/^$username$/,+1d" $FTP_USER_FILE
    
    # é‡æ–°ç”Ÿæˆæ•°æ®åº“
    db_load -T -t hash -f $FTP_USER_FILE $FTP_USER_DB
    
    # åˆ é™¤ç”¨æˆ·ç›®å½•
    rm -rf /var/ftp/users/$username
    
    echo "ç”¨æˆ· $username åˆ é™¤æˆåŠŸ"
}

# åˆ—å‡ºç”¨æˆ·
list_users() {
    echo "FTPè™šæ‹Ÿç”¨æˆ·åˆ—è¡¨ï¼š"
    grep -n "^[^#]" $FTP_USER_FILE | awk 'NR%2==1 {print NR/2+0.5": "$2}'
}

# ä¸»ç¨‹åº
case $1 in
    "add")
        add_user $2 $3
        ;;
    "del")
        del_user $2
        ;;
    "list")
        list_users
        ;;
    *)
        echo "ç”¨æ³•: $0 {add|del|list} [username] [password]"
        echo "ç¤ºä¾‹:"
        echo "  $0 add john 123456"
        echo "  $0 del john"  
        echo "  $0 list"
        exit 1
        ;;
esac
```

### 8.3 æ‰¹é‡éƒ¨ç½²è„šæœ¬


```bash
#!/bin/bash
# FTPæœåŠ¡æ‰¹é‡éƒ¨ç½²è„šæœ¬

# æœåŠ¡å™¨åˆ—è¡¨
SERVERS=(
    "192.168.1.10"
    "192.168.1.11" 
    "192.168.1.12"
)

# SSHå¯†é’¥æ–‡ä»¶
SSH_KEY="/root/.ssh/id_rsa"

# é…ç½®æ–‡ä»¶ç›®å½•
CONFIG_DIR="/opt/ftp-deploy"

echo "=== FTPæœåŠ¡æ‰¹é‡éƒ¨ç½² ==="

# éƒ¨ç½²å‡½æ•°
deploy_to_server() {
    local server_ip=$1
    echo ""
    echo "ğŸš€ å¼€å§‹éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼š$server_ip"
    
    # 1. å¤åˆ¶é…ç½®æ–‡ä»¶
    echo "  ğŸ“„ å¤åˆ¶é…ç½®æ–‡ä»¶..."
    scp -i $SSH_KEY $CONFIG_DIR/vsftpd.conf root@$server_ip:/etc/vsftpd/
    scp -i $SSH_KEY $CONFIG_DIR/virtual_users.txt root@$server_ip:/etc/vsftpd/
    
    # 2. æ‰§è¡Œè¿œç¨‹éƒ¨ç½²è„šæœ¬
    echo "  âš™ï¸ æ‰§è¡Œéƒ¨ç½²è„šæœ¬..."
    ssh -i $SSH_KEY root@$server_ip << 'EOF'
        # å®‰è£…FTPæœåŠ¡
        yum install -y vsftpd
        
        # ç”Ÿæˆç”¨æˆ·æ•°æ®åº“
        db_load -T -t hash -f /etc/vsftpd/virtual_users.txt \
                          /etc/vsftpd/virtual_users.db
        chmod 600 /etc/vsftpd/virtual_users.db
        
        # å¯åŠ¨æœåŠ¡
        systemctl enable vsftpd
        systemctl start vsftpd
        
        # é…ç½®é˜²ç«å¢™
        firewall-cmd --add-service=ftp --permanent
        firewall-cmd --reload
        
        echo "FTPæœåŠ¡éƒ¨ç½²å®Œæˆ"
EOF
    
    if [ $? -eq 0 ]; then
        echo "  âœ… æœåŠ¡å™¨ $server_ip éƒ¨ç½²æˆåŠŸ"
    else
        echo "  âŒ æœåŠ¡å™¨ $server_ip éƒ¨ç½²å¤±è´¥"
    fi
}

# æ‰¹é‡éƒ¨ç½²
for server in "${SERVERS[@]}"; do
    deploy_to_server $server
done

echo ""
echo "ğŸ‰ æ‰¹é‡éƒ¨ç½²å®Œæˆï¼"
```

### 8.4 å®šæ—¶ç»´æŠ¤è„šæœ¬


```bash
#!/bin/bash
# FTPæœåŠ¡å®šæ—¶ç»´æŠ¤è„šæœ¬

MAINTENANCE_LOG="/var/log/ftp_maintenance.log"

log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a $MAINTENANCE_LOG
}

log_message "=== å¼€å§‹FTPæœåŠ¡ç»´æŠ¤ ==="

# 1. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
log_message "æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
find /var/ftp/temp -name "*.tmp" -mtime +1 -delete
find /var/ftp/temp -name "*.part" -mtime +1 -delete

# 2. æ¸…ç†è¿‡æœŸæ—¥å¿—
log_message "æ¸…ç†è¿‡æœŸæ—¥å¿—..."
find /var/log -name "vsftpd.log.*" -mtime +30 -delete

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
log_message "æ£€æŸ¥ç£ç›˜ç©ºé—´..."
DISK_USAGE=$(df /var/ftp | awk 'NR==2 {print $5}' | cut -d'%' -f1)
if [ $DISK_USAGE -gt 85 ]; then
    log_message "âš ï¸ ç£ç›˜ç©ºé—´ä¸è¶³ï¼š$DISK_USAGE%"
    # æ¸…ç†æœ€è€çš„æ–‡ä»¶
    find /var/ftp -type f -atime +90 -size +100M -delete
    log_message "æ¸…ç†90å¤©æœªè®¿é—®çš„å¤§æ–‡ä»¶"
fi

# 4. ä¼˜åŒ–æ•°æ®åº“
log_message "ä¼˜åŒ–è™šæ‹Ÿç”¨æˆ·æ•°æ®åº“..."
db_dump /etc/vsftpd/virtual_users.db | db_load /tmp/virtual_users_new.db
mv /tmp/virtual_users_new.db /etc/vsftpd/virtual_users.db
chmod 600 /etc/vsftpd/virtual_users.db

# 5. é‡å¯æœåŠ¡ï¼ˆå¯é€‰ï¼Œè°¨æ…ä½¿ç”¨ï¼‰
# log_message "é‡å¯FTPæœåŠ¡..."
# systemctl restart vsftpd

log_message "=== FTPæœåŠ¡ç»´æŠ¤å®Œæˆ ==="
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é«˜å¯ç”¨æ¶æ„ï¼šæ¶ˆé™¤å•ç‚¹æ•…éšœï¼Œå®ç°æœåŠ¡å†—ä½™
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šåˆ†æ•£è¯·æ±‚å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿå¤„ç†èƒ½åŠ›  
ğŸ”¸ å…±äº«å­˜å‚¨ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæ”¯æŒå¤šæœåŠ¡å™¨è®¿é—®
ğŸ”¸ æ•…éšœåˆ‡æ¢ï¼šè‡ªåŠ¨æ£€æµ‹æ•…éšœï¼Œæ— æ„ŸçŸ¥æœåŠ¡è¿ç§»
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šæå‰å‘ç°é—®é¢˜ï¼Œä¿éšœæœåŠ¡ç¨³å®šæ€§
ğŸ”¸ å¤‡ä»½æ¢å¤ï¼šæ•°æ®å®‰å…¨ä¿éšœï¼Œä¸šåŠ¡è¿ç»­æ€§åŸºç¡€
ğŸ”¸ å®¹é‡è§„åˆ’ï¼šèµ„æºåˆç†é…ç½®ï¼Œæ”¯æ’‘ä¸šåŠ¡å‘å±•  
ğŸ”¸ è¿ç»´è‡ªåŠ¨åŒ–ï¼šæ ‡å‡†åŒ–æ“ä½œï¼Œæé«˜è¿ç»´æ•ˆç‡
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¼ä¸šçº§éƒ¨ç½²çš„æ ¸å¿ƒæ€æƒ³**
```
å¯é æ€§ä¼˜å…ˆï¼š
â€¢ å¤šé‡å†—ä½™ â†’ é¿å…å•ç‚¹æ•…éšœ
â€¢ è‡ªåŠ¨åˆ‡æ¢ â†’ å‡å°‘æ•…éšœå½±å“  
â€¢ å®Œå¤‡ç›‘æ§ â†’ æå‰é¢„è­¦

æ€§èƒ½ä¸æˆæœ¬å¹³è¡¡ï¼š
â€¢ åˆç†æ¶æ„ â†’ æ»¡è¶³éœ€æ±‚ä¸è¿‡åº¦
â€¢ å¼¹æ€§æ‰©å±• â†’ èµ„æºæŒ‰éœ€åˆ†é…
â€¢ è‡ªåŠ¨åŒ–è¿ç»´ â†’ é™ä½äººå·¥æˆæœ¬
```

**ğŸ”¹ æ–¹æ¡ˆé€‰æ‹©åŸåˆ™**
```
æ ¹æ®è§„æ¨¡é€‰æ‹©ï¼š
å°å‹ä¼ä¸šï¼šä¸»å¤‡æ¨¡å¼ + NFSå­˜å‚¨
ä¸­å‹ä¼ä¸šï¼šè´Ÿè½½å‡è¡¡ + GlusterFS  
å¤§å‹ä¼ä¸šï¼šé›†ç¾¤æ¶æ„ + Cephå­˜å‚¨

æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š
é«˜æ€§èƒ½è¦æ±‚ï¼šSSDå­˜å‚¨ + ä¸‡å…†ç½‘ç»œ
é«˜å¯ç”¨è¦æ±‚ï¼šå¤šæœºæˆ¿éƒ¨ç½² + å®æ—¶åŒæ­¥
ä½æˆæœ¬è¦æ±‚ï¼šå¼€æºæ–¹æ¡ˆ + äº‘å­˜å‚¨å¤‡ä»½
```

### 9.3 å®æ–½å…³é”®è¦ç‚¹


**ğŸ”¹ éƒ¨ç½²é˜¶æ®µé‡ç‚¹**
```
æ–¹æ¡ˆè®¾è®¡ï¼š
â€¢ éœ€æ±‚è°ƒç ”è¦å……åˆ†
â€¢ æ¶æ„è®¾è®¡è¦åˆç†  
â€¢ æŠ€æœ¯é€‰å‹è¦é€‚é…

å®æ–½è¿‡ç¨‹ï¼š
â€¢ åˆ†æ­¥å®æ–½é™é£é™©
â€¢ å……åˆ†æµ‹è¯•éªŒè¯
â€¢ æ–‡æ¡£è®°å½•å®Œæ•´
```

**ğŸ”¹ è¿ç»´é˜¶æ®µé‡ç‚¹**
```
æ—¥å¸¸è¿ç»´ï¼š
â€¢ ç›‘æ§æ•°æ®è¦å…³æ³¨
â€¢ å®šæœŸç»´æŠ¤è¦æ‰§è¡Œ
â€¢ é—®é¢˜å¤„ç†è¦åŠæ—¶

æŒç»­ä¼˜åŒ–ï¼š
â€¢ æ€§èƒ½ç“¶é¢ˆè¦è¯†åˆ«
â€¢ å®¹é‡å˜åŒ–è¦é¢„æµ‹
â€¢ æ–°æŠ€æœ¯è¦è¯„ä¼°
```

### 9.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ”¹ è®¾è®¡æœ€ä½³å®è·µ**
- âœ… éµå¾ªKISSåŸåˆ™ï¼ˆKeep It Simple, Stupidï¼‰
- âœ… é¢„ç•™è¶³å¤Ÿçš„æ‰©å±•ç©ºé—´
- âœ… è€ƒè™‘è¿ç»´çš„ä¾¿åˆ©æ€§
- âœ… é‡è§†å®‰å…¨æ€§å’Œåˆè§„æ€§

**ğŸ”¹ è¿ç»´æœ€ä½³å®è·µ**  
- âœ… å»ºç«‹å®Œå–„çš„æ–‡æ¡£ä½“ç³»
- âœ… åˆ¶å®šæ ‡å‡†çš„æ“ä½œæµç¨‹
- âœ… å®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
- âœ… æŒç»­å­¦ä¹ æ–°æŠ€æœ¯æ–°æ–¹æ³•

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ä¼ä¸šçº§FTPéƒ¨ç½²é‡åœ¨é«˜å¯ç”¨å’Œè‡ªåŠ¨åŒ–
- æ¶æ„è®¾è®¡è¦è€ƒè™‘ä¸šåŠ¡ç‰¹ç‚¹å’Œå‘å±•éœ€æ±‚
- è¿ç»´ç®¡ç†è¦æ ‡å‡†åŒ–ã€è‡ªåŠ¨åŒ–ã€å¯è§†åŒ–
- æŒç»­ä¼˜åŒ–æ˜¯ä¿æŒç³»ç»Ÿå¥åº·çš„å…³é”®