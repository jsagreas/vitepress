---
title: 10ã€AppArmoræ¶æ„ä¸é…ç½®
---
## ğŸ“š ç›®å½•

1. [AppArmoråŸºç¡€æ¦‚å¿µ](#1-AppArmoråŸºç¡€æ¦‚å¿µ)
2. [LSMæ¨¡å—æ¶æ„åŸç†](#2-LSMæ¨¡å—æ¶æ„åŸç†)
3. [è·¯å¾„åŸºç¡€è®¿é—®æ§åˆ¶](#3-è·¯å¾„åŸºç¡€è®¿é—®æ§åˆ¶)
4. [å·¥ä½œæ¨¡å¼è¯¦è§£](#4-å·¥ä½œæ¨¡å¼è¯¦è§£)
5. [é…ç½®ç›®å½•ä¸æ–‡ä»¶ç»“æ„](#5-é…ç½®ç›®å½•ä¸æ–‡ä»¶ç»“æ„)
6. [ç®¡ç†å‘½ä»¤ä¸å·¥å…·](#6-ç®¡ç†å‘½ä»¤ä¸å·¥å…·)
7. [Profileé…ç½®æ–‡ä»¶è¯­æ³•](#7-Profileé…ç½®æ–‡ä»¶è¯­æ³•)
8. [å®è·µåº”ç”¨ä¸æœ€ä½³å®è·µ](#8-å®è·µåº”ç”¨ä¸æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ AppArmoråŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯AppArmor


**ç®€å•ç†è§£**ï¼šAppArmorå°±åƒç»™æ¯ä¸ªç¨‹åºå¥—ä¸Šä¸€ä¸ª"å®‰å…¨ç¬¼å­"ï¼Œé™åˆ¶å®ƒèƒ½åšä»€ä¹ˆã€ä¸èƒ½åšä»€ä¹ˆã€‚

```
ç±»æ¯”ç”Ÿæ´»åœºæ™¯ï¼š
ğŸ  å®¶é•¿ç»™å­©å­åˆ¶å®šè§„åˆ™ï¼š
   âœ… å¯ä»¥åœ¨å®¢å…ç©è€
   âœ… å¯ä»¥å»å¨æˆ¿å–æ°´
   âŒ ä¸èƒ½è¿›å…¥å±é™©çš„åœ°ä¸‹å®¤
   âŒ ä¸èƒ½ç¢°å±é™©ç‰©å“

ğŸ”’ AppArmorç»™ç¨‹åºåˆ¶å®šè§„åˆ™ï¼š
   âœ… WebæœåŠ¡å™¨å¯ä»¥è®¿é—®/var/www/ç›®å½•
   âœ… å¯ä»¥ç›‘å¬80å’Œ443ç«¯å£
   âŒ ä¸èƒ½è®¿é—®/etc/passwdæ–‡ä»¶
   âŒ ä¸èƒ½æ‰§è¡Œç³»ç»Ÿç®¡ç†å‘½ä»¤
```

**ğŸ”¥ æ ¸å¿ƒä½œç”¨**ï¼š
- **é™åˆ¶ç¨‹åºæƒé™**ï¼šå³ä½¿ç¨‹åºè¢«æ”»å‡»ï¼Œä¹Ÿæ— æ³•è¶…å‡ºé¢„è®¾èŒƒå›´
- **é˜²æ­¢æƒé™æ»¥ç”¨**ï¼šç¨‹åºåªèƒ½åšå®ƒè¯¥åšçš„äº‹æƒ…
- **é™ä½å®‰å…¨é£é™©**ï¼šå‡å°‘ç³»ç»Ÿè¢«å…¥ä¾µåçš„æŸå¤±

### 1.2 AppArmor vs SELinuxå¯¹æ¯”


| ç‰¹æ€§å¯¹æ¯” | **AppArmor** | **SELinux** |
|---------|-------------|-------------|
| ğŸ¯ **æ§åˆ¶æ–¹å¼** | `åŸºäºæ–‡ä»¶è·¯å¾„` | `åŸºäºæ ‡ç­¾(Label)` |
| ğŸ“ **é…ç½®å¤æ‚åº¦** | `ç›¸å¯¹ç®€å•ï¼Œæ˜“å­¦` | `å¤æ‚ï¼Œå­¦ä¹ æˆæœ¬é«˜` |
| ğŸ”§ **é»˜è®¤ä½¿ç”¨** | `Ubuntu/SUSEé»˜è®¤` | `Red Hat/CentOSé»˜è®¤` |
| âš¡ **æ€§èƒ½å½±å“** | `è¾ƒå°` | `ç›¸å¯¹è¾ƒå¤§` |
| ğŸ› ï¸ **ç»´æŠ¤æˆæœ¬** | `ä½` | `é«˜` |

> ğŸ’¡ **é€‰æ‹©å»ºè®®**ï¼šæ–°æ‰‹æ¨èAppArmorï¼Œå› ä¸ºå®ƒæ›´å®¹æ˜“ç†è§£å’Œé…ç½®ã€‚

### 1.3 AppArmorçš„è®¾è®¡å“²å­¦


**ğŸ¯ è®¾è®¡ç†å¿µ**ï¼š
```
æœ€å°æƒé™åŸåˆ™ï¼š
ç¨‹åºåªè·å¾—å®Œæˆä»»åŠ¡æ‰€éœ€çš„æœ€å°æƒé™

è·¯å¾„å¯¼å‘å®‰å…¨ï¼š
åŸºäºæ–‡ä»¶è·¯å¾„è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œç›´è§‚æ˜“æ‡‚

é»˜è®¤æ‹’ç»ç­–ç•¥ï¼š
æ²¡æœ‰æ˜ç¡®å…è®¸çš„æ“ä½œä¸€å¾‹ç¦æ­¢
```

---

## 2. ğŸ—ï¸ LSMæ¨¡å—æ¶æ„åŸç†


### 2.1 ä»€ä¹ˆæ˜¯LSM


**é€šä¿—è§£é‡Š**ï¼šLSMï¼ˆLinux Security Modulesï¼‰å°±åƒLinuxå†…æ ¸çš„"å®‰å…¨æ’ä»¶æ¥å£"ï¼Œå…è®¸ä¸åŒçš„å®‰å…¨ç³»ç»Ÿæ’å…¥å†…æ ¸å·¥ä½œã€‚

```
å†…æ ¸æ¶æ„ç¤ºæ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ç”¨æˆ·ç©ºé—´           â”‚ â† åº”ç”¨ç¨‹åºè¿è¡Œå±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ç³»ç»Ÿè°ƒç”¨æ¥å£         â”‚ â† ç¨‹åºè¯·æ±‚å†…æ ¸æœåŠ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   LSMå®‰å…¨é’©å­æ¡†æ¶       â”‚ â† AppArmoråœ¨è¿™é‡Œå·¥ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Linuxå†…æ ¸          â”‚ â† ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 AppArmor LSMå·¥ä½œåŸç†


**âš¡ å·¥ä½œæµç¨‹**ï¼š
```
ç¨‹åºè¯·æ±‚è®¿é—®æ–‡ä»¶ï¼š
åº”ç”¨ç¨‹åº â†’ ç³»ç»Ÿè°ƒç”¨ â†’ LSMé’©å­ â†’ AppArmoræ£€æŸ¥ â†’ å†…æ ¸æ‰§è¡Œ

æ£€æŸ¥è¿‡ç¨‹ï¼š
1ï¸âƒ£ ç¨‹åºè¦æ‰“å¼€æ–‡ä»¶/etc/hosts
2ï¸âƒ£ LSMé’©å­æ‹¦æˆªè¿™ä¸ªè¯·æ±‚
3ï¸âƒ£ AppArmoræ£€æŸ¥è¯¥ç¨‹åºçš„profileé…ç½®
4ï¸âƒ£ æ ¹æ®é…ç½®å†³å®šå…è®¸æˆ–æ‹’ç»
5ï¸âƒ£ è¿”å›ç»“æœç»™ç¨‹åº
```

**ğŸ” é’©å­å‡½æ•°ä½ç½®**ï¼š
```
æ–‡ä»¶è®¿é—®é’©å­ï¼šfile_permission()
ç¨‹åºæ‰§è¡Œé’©å­ï¼šbprm_check_security()
ç½‘ç»œè®¿é—®é’©å­ï¼šsocket_create()
è¿›ç¨‹é—´é€šä¿¡é’©å­ï¼šipc_permission()
```

### 2.3 LSMå®‰å…¨é’©å­æœºåˆ¶


**ğŸª é’©å­å·¥ä½œæœºåˆ¶**ï¼š

```
æ­£å¸¸æµç¨‹ï¼ˆæ— AppArmorï¼‰ï¼š
ç¨‹åº â†’ å†…æ ¸ â†’ æ‰§è¡Œæ“ä½œ

å®‰å…¨æµç¨‹ï¼ˆæœ‰AppArmorï¼‰ï¼š
ç¨‹åº â†’ å†…æ ¸ â†’ LSMé’©å­ â†’ AppArmoræ£€æŸ¥ â†’ æ‰§è¡Œæˆ–æ‹’ç»
```

**å®é™…ç¤ºä¾‹**ï¼š
```bash
# ç¨‹åºå°è¯•è¯»å–æ•æ„Ÿæ–‡ä»¶
cat /etc/shadow

# AppArmoræ‹¦æˆªè¿‡ç¨‹ï¼š
1. catç¨‹åºå‘èµ·è¯»å–è¯·æ±‚
2. file_permission()é’©å­è¢«è°ƒç”¨
3. AppArmoræ£€æŸ¥catç¨‹åºçš„profile
4. å‘ç°æ²¡æœ‰è¯»å–/etc/shadowçš„æƒé™
5. è¿”å›"Permission denied"é”™è¯¯
```

---

## 3. ğŸ“ è·¯å¾„åŸºç¡€è®¿é—®æ§åˆ¶


### 3.1 è·¯å¾„æ§åˆ¶æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ åŸºæœ¬æ€æƒ³**ï¼šAppArmoré€šè¿‡æ–‡ä»¶è·¯å¾„æ¥åˆ¤æ–­ç¨‹åºèƒ½å¦è®¿é—®æŸä¸ªèµ„æºã€‚

```
è·¯å¾„æ§åˆ¶ç¤ºä¾‹ï¼š
â”Œâ”€ WebæœåŠ¡å™¨nginx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…è®¸è®¿é—®ï¼š               â”‚
â”‚ âœ… /var/www/**          â”‚ â† ç½‘ç«™æ–‡ä»¶
â”‚ âœ… /var/log/nginx/**    â”‚ â† æ—¥å¿—æ–‡ä»¶
â”‚ âœ… /etc/nginx/**        â”‚ â† é…ç½®æ–‡ä»¶
â”‚                         â”‚
â”‚ ç¦æ­¢è®¿é—®ï¼š               â”‚
â”‚ âŒ /etc/passwd          â”‚ â† ç³»ç»Ÿå¯†ç æ–‡ä»¶
â”‚ âŒ /root/**             â”‚ â† ç®¡ç†å‘˜ç›®å½•
â”‚ âŒ /home/**             â”‚ â† ç”¨æˆ·ç›®å½•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 è·¯å¾„åŒ¹é…è§„åˆ™


**ğŸ”¤ é€šé…ç¬¦è¯­æ³•**ï¼š

| é€šé…ç¬¦ | **å«ä¹‰** | **ç¤ºä¾‹** | **åŒ¹é…è¯´æ˜** |
|-------|---------|---------|-------------|
| `*` | `åŒ¹é…å•å±‚è·¯å¾„ä¸­çš„ä»»æ„å­—ç¬¦` | `/var/log/*.log` | `åŒ¹é…å•ä¸ªæ–‡ä»¶å` |
| `**` | `åŒ¹é…å¤šå±‚è·¯å¾„` | `/var/www/**` | `åŒ¹é…æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶` |
| `?` | `åŒ¹é…å•ä¸ªå­—ç¬¦` | `/tmp/file?.txt` | `åŒ¹é…file1.txtç­‰` |
| `[]` | `åŒ¹é…å­—ç¬¦é›†åˆ` | `/var/log/[abc]*` | `åŒ¹é…aã€bã€cå¼€å¤´çš„æ–‡ä»¶` |
| `{}` | `åŒ¹é…å¤šä¸ªé€‰é¡¹` | `/etc/{hosts,passwd}` | `åŒ¹é…ä¸¤ä¸ªæŒ‡å®šæ–‡ä»¶` |

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š
```bash
# å…è®¸è®¿é—®webç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
/var/www/** r,

# å…è®¸è®¿é—®ç‰¹å®šæ—¥å¿—æ–‡ä»¶
/var/log/nginx/*.log w,

# å…è®¸è®¿é—®é…ç½®æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
/etc/nginx/{nginx.conf,mime.types} r,
```

### 3.3 è·¯å¾„æƒé™æ§åˆ¶


**ğŸ“‹ æƒé™æ ‡è®°è¯´æ˜**ï¼š

```
æƒé™å­—æ¯å«ä¹‰ï¼š
r â†’ readï¼ˆè¯»å–ï¼‰
w â†’ writeï¼ˆå†™å…¥ï¼‰  
a â†’ appendï¼ˆè¿½åŠ ï¼‰
x â†’ executeï¼ˆæ‰§è¡Œï¼‰
m â†’ memory mapï¼ˆå†…å­˜æ˜ å°„ï¼‰
k â†’ lockï¼ˆæ–‡ä»¶é”å®šï¼‰
l â†’ linkï¼ˆåˆ›å»ºé“¾æ¥ï¼‰
```

**ğŸ”§ æƒé™ç»„åˆç¤ºä¾‹**ï¼š
```bash
# åªè¯»æƒé™
/etc/passwd r,

# è¯»å†™æƒé™
/tmp/myapp.log rw,

# æ‰§è¡Œæƒé™
/usr/bin/python3 rix,

# å¤åˆæƒé™ï¼ˆè¯»ã€å†™ã€æ‰§è¡Œï¼‰
/opt/myapp/** rwx,
```

> âš ï¸ **é‡è¦æé†’**ï¼šæƒé™æ ‡è®°åŒºåˆ†å¤§å°å†™ï¼Œ`r`å’Œ`R`å«ä¹‰ä¸åŒã€‚

---

## 4. ğŸ”„ å·¥ä½œæ¨¡å¼è¯¦è§£


### 4.1 Enforceå¼ºåˆ¶æ¨¡å¼


**ğŸ”’ å¼ºåˆ¶æ¨¡å¼ç‰¹ç‚¹**ï¼š
- **ä¸¥æ ¼æ‰§è¡Œ**ï¼šè¿åè§„åˆ™çš„æ“ä½œä¼šè¢«ç›´æ¥é˜»æ­¢
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé€‚åˆæ­£å¼è¿è¡Œçš„ç³»ç»Ÿ
- **å®‰å…¨ä¼˜å…ˆ**ï¼šå®å¯ç¨‹åºå‡ºé”™ä¹Ÿä¸å…è®¸è¿è§„æ“ä½œ

```
Enforceæ¨¡å¼å·¥ä½œæµç¨‹ï¼š
ç¨‹åºè¯·æ±‚ â†’ AppArmoræ£€æŸ¥ â†’ è¿åè§„åˆ™ â†’ ç›´æ¥æ‹’ç» â†’ è®°å½•æ—¥å¿—

å®é™…æ•ˆæœï¼š
$ cat /etc/shadow
cat: /etc/shadow: Permission denied  â† ç›´æ¥è¢«é˜»æ­¢
```

**å¯ç”¨å¼ºåˆ¶æ¨¡å¼**ï¼š
```bash
# å°†profileè®¾ç½®ä¸ºenforceæ¨¡å¼
sudo aa-enforce /etc/apparmor.d/usr.bin.firefox

# æŸ¥çœ‹å½“å‰æ¨¡å¼
sudo aa-status
```

### 4.2 ComplainæŠ•è¯‰æ¨¡å¼


**ğŸ“ æŠ•è¯‰æ¨¡å¼ç‰¹ç‚¹**ï¼š
- **ä»…è®°å½•ä¸é˜»æ­¢**ï¼šè¿è§„æ“ä½œä¼šè¢«è®°å½•ä½†ä¸ä¼šé˜»æ­¢
- **æµ‹è¯•ç¯å¢ƒ**ï¼šé€‚åˆå¼€å‘å’Œæµ‹è¯•é˜¶æ®µ
- **å­¦ä¹ æ¨¡å¼**ï¼šç”¨äºäº†è§£ç¨‹åºçš„å®é™…è¡Œä¸º

```
Complainæ¨¡å¼å·¥ä½œæµç¨‹ï¼š
ç¨‹åºè¯·æ±‚ â†’ AppArmoræ£€æŸ¥ â†’ è¿åè§„åˆ™ â†’ å…è®¸æ‰§è¡Œ â†’ è®°å½•å‘Šè­¦

å®é™…æ•ˆæœï¼š
$ cat /etc/shadow
root:!:18234:0:99999:7:::  â† èƒ½æ­£å¸¸æ‰§è¡Œ
# ä½†ä¼šåœ¨æ—¥å¿—ä¸­è®°å½•è¿è§„è¡Œä¸º
```

**å¯ç”¨æŠ•è¯‰æ¨¡å¼**ï¼š
```bash
# å°†profileè®¾ç½®ä¸ºcomplainæ¨¡å¼
sudo aa-complain /etc/apparmor.d/usr.bin.firefox

# æŸ¥çœ‹complainæ¨¡å¼çš„æ—¥å¿—
sudo dmesg | grep apparmor
```

### 4.3 æ¨¡å¼è½¬æ¢ä¸ä½¿ç”¨åœºæ™¯


**ğŸ”„ æ¨¡å¼è½¬æ¢ç­–ç•¥**ï¼š

```
æ¨èå·¥ä½œæµç¨‹ï¼š
1ï¸âƒ£ Complainæ¨¡å¼ â†’ è§‚å¯Ÿç¨‹åºè¡Œä¸º
2ï¸âƒ£ åˆ†ææ—¥å¿— â†’ å®Œå–„profileè§„åˆ™
3ï¸âƒ£ Enforceæ¨¡å¼ â†’ æ­£å¼å¯ç”¨ä¿æŠ¤

ä½¿ç”¨åœºæ™¯é€‰æ‹©ï¼š
ğŸ§ª æ–°åº”ç”¨éƒ¨ç½² â†’ Complainæ¨¡å¼
ğŸ“Š è§„åˆ™è°ƒè¯• â†’ Complainæ¨¡å¼  
ğŸš€ ç”Ÿäº§ç¯å¢ƒ â†’ Enforceæ¨¡å¼
ğŸ”§ ç´§æ€¥ä¿®å¤ â†’ ä¸´æ—¶Complainæ¨¡å¼
```

**æ¨¡å¼ç®¡ç†å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰profileçš„çŠ¶æ€
sudo aa-status

# æ‰¹é‡è®¾ç½®enforceæ¨¡å¼
sudo aa-enforce /etc/apparmor.d/*

# æ‰¹é‡è®¾ç½®complainæ¨¡å¼
sudo aa-complain /etc/apparmor.d/*
```

---

## 5. ğŸ“‚ é…ç½®ç›®å½•ä¸æ–‡ä»¶ç»“æ„


### 5.1 /etc/apparmor.d/ç›®å½•ç»“æ„


**ğŸ—‚ï¸ ä¸»è¦ç›®å½•è¯´æ˜**ï¼š

```
AppArmoré…ç½®æ–‡ä»¶ç»“æ„ï¼š
/etc/apparmor.d/
â”œâ”€â”€ usr.bin.firefox          â† Firefoxæµè§ˆå™¨profile
â”œâ”€â”€ usr.sbin.nginx           â† NginxæœåŠ¡å™¨profile
â”œâ”€â”€ usr.bin.evince           â† PDFé˜…è¯»å™¨profile
â”œâ”€â”€ abstractions/            â† æŠ½è±¡è§„åˆ™ç›®å½•
â”‚   â”œâ”€â”€ base                 â† åŸºç¡€ç³»ç»Ÿè®¿é—®
â”‚   â”œâ”€â”€ ssl_certs            â† SSLè¯ä¹¦è®¿é—®
â”‚   â””â”€â”€ web-data             â† Webæ•°æ®è®¿é—®
â”œâ”€â”€ tunables/                â† å¯è°ƒå‚æ•°ç›®å½•
â”‚   â””â”€â”€ global               â† å…¨å±€å˜é‡å®šä¹‰
â””â”€â”€ local/                   â† æœ¬åœ°è‡ªå®šä¹‰è§„åˆ™
    â”œâ”€â”€ usr.bin.firefox      â† Firefoxæœ¬åœ°è§„åˆ™
    â””â”€â”€ usr.sbin.nginx       â† Nginxæœ¬åœ°è§„åˆ™
```

### 5.2 Profileæ–‡ä»¶å‘½åè§„åˆ™


**ğŸ“ å‘½åçº¦å®š**ï¼š
```
æ–‡ä»¶è·¯å¾„è½¬æ¢è§„åˆ™ï¼š
/usr/bin/firefox  â†’ usr.bin.firefox
/usr/sbin/nginx   â†’ usr.sbin.nginx
/opt/myapp/server â†’ opt.myapp.server

è½¬æ¢æ–¹æ³•ï¼š
1. å»æ‰å¼€å¤´çš„"/"
2. å°†å…¶ä»–"/"æ›¿æ¢ä¸º"."
3. æ–‡ä»¶åå³ä¸ºprofileåç§°
```

**å®é™…ç¤ºä¾‹**ï¼š
```bash
# æŸ¥çœ‹profileæ–‡ä»¶
ls /etc/apparmor.d/usr.bin.*
/etc/apparmor.d/usr.bin.firefox
/etc/apparmor.d/usr.bin.thunderbird
/etc/apparmor.d/usr.bin.evince

# å¯¹åº”çš„ç¨‹åºè·¯å¾„
/usr/bin/firefox      â† Firefoxæµè§ˆå™¨
/usr/bin/thunderbird  â† é›·é¸Ÿé‚®ä»¶å®¢æˆ·ç«¯  
/usr/bin/evince       â† æ–‡æ¡£æŸ¥çœ‹å™¨
```

### 5.3 AbstractionsæŠ½è±¡è§„åˆ™


**ğŸ¯ æŠ½è±¡è§„åˆ™ä½œç”¨**ï¼šå°†å¸¸ç”¨çš„è®¿é—®æ¨¡å¼æå–æˆå¯é‡ç”¨çš„æ¨¡å—ã€‚

```
å¸¸ç”¨æŠ½è±¡è§„åˆ™ï¼š
base                 â† åŸºæœ¬ç³»ç»Ÿåº“å’Œæ–‡ä»¶è®¿é—®
nameservice          â† DNSè§£æç›¸å…³
ssl_certs            â† SSL/TLSè¯ä¹¦è®¿é—®
fonts                â† å­—ä½“æ–‡ä»¶è®¿é—®
audio                â† éŸ³é¢‘è®¾å¤‡è®¿é—®
```

**ä½¿ç”¨æŠ½è±¡è§„åˆ™**ï¼š
```bash
# åœ¨profileä¸­å¼•ç”¨æŠ½è±¡è§„åˆ™
profile /usr/bin/myapp {
  #include <abstractions/base>      â† åŒ…å«åŸºç¡€è®¿é—®æƒé™
  #include <abstractions/ssl_certs> â† åŒ…å«SSLè¯ä¹¦è®¿é—®
  
  # ç¨‹åºç‰¹å®šçš„è§„åˆ™
  /opt/myapp/** r,
}
```

### 5.4 Tunableså¯è°ƒå‚æ•°


**âš™ï¸ å…¨å±€å˜é‡å®šä¹‰**ï¼š
```bash
# /etc/apparmor.d/tunables/global æ–‡ä»¶å†…å®¹
@{HOME} = @{HOMEDIRS}/*
@{HOMEDIRS} = /home
@{multiarch} = *-linux-gnu*
@{PROC} = /proc/

# åœ¨profileä¸­ä½¿ç”¨å˜é‡
profile /usr/bin/myapp {
  @{HOME}/.config/myapp/** rw,    â† ä½¿ç”¨HOMEå˜é‡
  @{PROC}/version r,              â† ä½¿ç”¨PROCå˜é‡
}
```

---

## 6. ğŸ› ï¸ ç®¡ç†å‘½ä»¤ä¸å·¥å…·


### 6.1 aa-statusçŠ¶æ€æŸ¥çœ‹


**ğŸ“Š æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€**ï¼š

```bash
# æŸ¥çœ‹AppArmoræ•´ä½“çŠ¶æ€
sudo aa-status

# è¾“å‡ºç¤ºä¾‹ï¼š
apparmor module is loaded.
15 profiles are loaded.
13 profiles are in enforce mode.
   /usr/bin/firefox
   /usr/sbin/nginx
   /usr/bin/evince
2 profiles are in complain mode.
   /usr/bin/test-app
   /usr/bin/debug-tool
```

**ğŸ” è¯¦ç»†çŠ¶æ€ä¿¡æ¯**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
sudo aa-status --verbose

# åªæŸ¥çœ‹enforceæ¨¡å¼çš„profile
sudo aa-status --enforced

# åªæŸ¥çœ‹complainæ¨¡å¼çš„profile  
sudo aa-status --complaining
```

### 6.2 apparmor_parserç­–ç•¥åŠ è½½å™¨


**âš¡ æ ¸å¿ƒåŠ è½½å·¥å…·**ï¼šapparmor_parserè´Ÿè´£è§£æå’ŒåŠ è½½profileåˆ°å†…æ ¸ã€‚

```bash
# åŠ è½½å•ä¸ªprofile
sudo apparmor_parser -r /etc/apparmor.d/usr.bin.firefox

# åŠ è½½æ‰€æœ‰profiles
sudo apparmor_parser -r /etc/apparmor.d/

# æ£€æŸ¥profileè¯­æ³•
sudo apparmor_parser -Q /etc/apparmor.d/usr.bin.myapp
```

**ğŸ“‹ å¸¸ç”¨å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | **ä½œç”¨** | **ç¤ºä¾‹** |
|------|---------|---------|
| `-r` | `é‡æ–°åŠ è½½profile` | `apparmor_parser -r profile_file` |
| `-R` | `ç§»é™¤profile` | `apparmor_parser -R profile_file` |
| `-Q` | `æ£€æŸ¥è¯­æ³•ä¸åŠ è½½` | `apparmor_parser -Q profile_file` |
| `-C` | `ä½¿ç”¨ç¼“å­˜` | `apparmor_parser -C profile_file` |

### 6.3 Profileç®¡ç†å‘½ä»¤é›†


**ğŸ”§ ä¾¿æ·ç®¡ç†å·¥å…·**ï¼š

```bash
# æ¨¡å¼åˆ‡æ¢å‘½ä»¤
sudo aa-enforce profile_name     # åˆ‡æ¢åˆ°enforceæ¨¡å¼
sudo aa-complain profile_name    # åˆ‡æ¢åˆ°complainæ¨¡å¼
sudo aa-disable profile_name     # ç¦ç”¨profile

# æ‰¹é‡æ“ä½œ
sudo aa-enforce /etc/apparmor.d/*        # å…¨éƒ¨enforce
sudo aa-complain /etc/apparmor.d/usr.*   # æ‰¹é‡complain
```

**ğŸ”„ æœåŠ¡ç®¡ç†**ï¼š
```bash
# AppArmoræœåŠ¡æ§åˆ¶
sudo systemctl status apparmor    # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl restart apparmor   # é‡å¯æœåŠ¡
sudo systemctl reload apparmor    # é‡æ–°åŠ è½½é…ç½®

# å¼€æœºè‡ªå¯åŠ¨
sudo systemctl enable apparmor    # å¯ç”¨å¼€æœºè‡ªå¯
sudo systemctl disable apparmor   # ç¦ç”¨å¼€æœºè‡ªå¯
```

### 6.4 æ—¥å¿—åˆ†æå·¥å…·


**ğŸ“ æŸ¥çœ‹AppArmoræ—¥å¿—**ï¼š

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„AppArmorè®°å½•
sudo dmesg | grep apparmor

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -f | grep apparmor

# è§£æauditæ—¥å¿—ï¼ˆå¦‚æœå¯ç”¨äº†auditdï¼‰
sudo aa-logprof    # äº¤äº’å¼æ—¥å¿—åˆ†æå·¥å…·
```

**å®é™…æ—¥å¿—ç¤ºä¾‹**ï¼š
```
audit: type=1400 audit(1694678400.123:456): apparmor="DENIED" 
operation="open" profile="/usr/bin/firefox" name="/etc/passwd" 
pid=1234 comm="firefox" requested_mask="r" denied_mask="r"
```

---

## 7. ğŸ“ Profileé…ç½®æ–‡ä»¶è¯­æ³•


### 7.1 ProfileåŸºæœ¬ç»“æ„


**ğŸ“‹ æ ‡å‡†profileæ¨¡æ¿**ï¼š

```bash
# /etc/apparmor.d/usr.bin.myapp
#include <tunables/global>

profile /usr/bin/myapp {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  
  # å¯æ‰§è¡Œæ–‡ä»¶æƒé™
  /usr/bin/myapp r,
  
  # é…ç½®æ–‡ä»¶æƒé™
  /etc/myapp/** r,
  
  # æ•°æ®æ–‡ä»¶æƒé™
  /var/lib/myapp/** rw,
  
  # æ—¥å¿—æ–‡ä»¶æƒé™
  /var/log/myapp/*.log w,
  
  # ä¸´æ—¶æ–‡ä»¶æƒé™
  /tmp/myapp-* rw,
}
```

### 7.2 è¯­æ³•è¦ç´ è¯¦è§£


**ğŸ”¤ åŸºæœ¬è¯­æ³•è§„åˆ™**ï¼š

```bash
# æ³¨é‡Šè¯­æ³•
# è¿™æ˜¯å•è¡Œæ³¨é‡Š

# åŒ…å«å…¶ä»–æ–‡ä»¶
#include <abstractions/base>        # ç³»ç»ŸæŠ½è±¡
#include "/etc/apparmor.d/local/myapp"  # æœ¬åœ°æ–‡ä»¶

# å˜é‡å®šä¹‰å’Œä½¿ç”¨
@{MYAPP_HOME} = /opt/myapp
@{MYAPP_HOME}/bin/* rix,

# æ–‡ä»¶æƒé™è¯­æ³•
è·¯å¾„æ¨¡å¼ æƒé™æ ‡è®°,
/etc/passwd r,                      # åªè¯»
/var/log/app.log w,                 # åªå†™
/tmp/data.txt rw,                   # è¯»å†™
/usr/bin/editor rix,                # è¯»ã€ç»§æ‰¿ã€æ‰§è¡Œ
```

### 7.3 é«˜çº§è¯­æ³•ç‰¹æ€§


**ğŸª æ¡ä»¶ä¸å˜é‡**ï¼š

```bash
# ç½‘ç»œæƒé™
network inet tcp,           # å…è®¸TCPç½‘ç»œè¿æ¥
network inet udp,           # å…è®¸UDPç½‘ç»œè¿æ¥
network unix,               # å…è®¸Unix socket

# èƒ½åŠ›æƒé™ï¼ˆcapabilitiesï¼‰
capability net_bind_service,    # å…è®¸ç»‘å®šç‰¹æƒç«¯å£
capability dac_override,       # å…è®¸å¿½ç•¥æ–‡ä»¶æƒé™

# ä¿¡å·å¤„ç†
signal (send) set=(term, kill) peer=/usr/bin/target,
signal (receive) set=(usr1, usr2),
```

**ğŸ”— Profileé—´äº¤äº’**ï¼š
```bash
# ç¨‹åºè½¬æ¢ï¼ˆtransitionï¼‰
/usr/bin/python3 Px,              # åˆ‡æ¢åˆ°python3çš„profile
/usr/bin/editor px,               # ä½¿ç”¨ç‹¬ç«‹çš„å­profile
/bin/sh Cx -> /bin/sh,            # åˆ‡æ¢åˆ°æŒ‡å®šprofile

# å­profileå®šä¹‰
profile /bin/sh {
  /bin/sh rm,
  /bin/* rix,
  /usr/bin/* rix,
}
```

### 7.4 å®ç”¨é…ç½®ç¤ºä¾‹


**ğŸŒ WebæœåŠ¡å™¨é…ç½®**ï¼š
```bash
# nginx profileç¤ºä¾‹
profile /usr/sbin/nginx {
  #include <abstractions/base>
  #include <abstractions/web-data>
  
  # nginxæ‰§è¡Œæ–‡ä»¶
  /usr/sbin/nginx mr,
  
  # é…ç½®æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
  /etc/nginx/** r,
  
  # ç½‘ç«™å†…å®¹ï¼ˆåªè¯»ï¼‰
  /var/www/** r,
  
  # æ—¥å¿—æ–‡ä»¶ï¼ˆå†™å…¥ï¼‰
  /var/log/nginx/** w,
  
  # PIDæ–‡ä»¶
  /var/run/nginx.pid w,
  
  # ç½‘ç»œæƒé™
  network inet stream,
  
  # ç³»ç»Ÿèƒ½åŠ›
  capability net_bind_service,
  capability setuid,
  capability setgid,
}
```

**ğŸ“§ é‚®ä»¶å®¢æˆ·ç«¯é…ç½®**ï¼š
```bash
# é‚®ä»¶å®¢æˆ·ç«¯profile
profile /usr/bin/thunderbird {
  #include <abstractions/base>
  #include <abstractions/ssl_certs>
  #include <abstractions/fonts>
  
  # ç¨‹åºæ–‡ä»¶
  /usr/bin/thunderbird mr,
  /usr/lib/thunderbird/** mr,
  
  # ç”¨æˆ·æ•°æ®
  @{HOME}/.thunderbird/ rw,
  @{HOME}/.thunderbird/** rw,
  
  # ä¸‹è½½ç›®å½•
  @{HOME}/Downloads/ rw,
  @{HOME}/Downloads/** rw,
  
  # ç½‘ç»œè®¿é—®
  network inet tcp,
  network inet udp,
}
```

---

## 8. ğŸš€ å®è·µåº”ç”¨ä¸æœ€ä½³å®è·µ


### 8.1 æ–°åº”ç”¨Profileåˆ›å»ºæµç¨‹


**ğŸ“‹ æ ‡å‡†åˆ›å»ºæµç¨‹**ï¼š

```
Step 1: ç”Ÿæˆåˆå§‹profile
1ï¸âƒ£ å®‰è£…åº”ç”¨ç¨‹åº
2ï¸âƒ£ ä½¿ç”¨aa-genprofç”ŸæˆåŸºç¡€profile
3ï¸âƒ£ è®¾ç½®ä¸ºcomplainæ¨¡å¼è§‚å¯Ÿè¡Œä¸º

Step 2: æ”¶é›†è®¿é—®æ¨¡å¼
1ï¸âƒ£ æ­£å¸¸ä½¿ç”¨åº”ç”¨ç¨‹åº
2ï¸âƒ£ æ‰§è¡Œå„ç§åŠŸèƒ½æ“ä½œ
3ï¸âƒ£ æ”¶é›†complainæ—¥å¿—

Step 3: å®Œå–„profileè§„åˆ™
1ï¸âƒ£ åˆ†ææ—¥å¿—æ‰¾å‡ºéœ€è¦çš„æƒé™
2ï¸âƒ£ æ·»åŠ å¿…è¦çš„è®¿é—®è§„åˆ™
3ï¸âƒ£ å»é™¤ä¸éœ€è¦çš„æƒé™

Step 4: æµ‹è¯•ä¸éƒ¨ç½²
1ï¸âƒ£ åˆ‡æ¢åˆ°enforceæ¨¡å¼æµ‹è¯•
2ï¸âƒ£ éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸
3ï¸âƒ£ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```

**ğŸ› ï¸ å®é™…æ“ä½œç¤ºä¾‹**ï¼š
```bash
# 1. ä¸ºæ–°åº”ç”¨ç”Ÿæˆprofile
sudo aa-genprof /usr/bin/myapp

# 2. è¿è¡Œåº”ç”¨ï¼Œæ‰§è¡Œå„ç§æ“ä½œ
/usr/bin/myapp

# 3. åˆ†ææ—¥å¿—å¹¶å®Œå–„è§„åˆ™
sudo aa-logprof

# 4. åˆ‡æ¢åˆ°enforceæ¨¡å¼
sudo aa-enforce /etc/apparmor.d/usr.bin.myapp
```

### 8.2 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ¯ å®‰å…¨é…ç½®åŸåˆ™**ï¼š

```
æœ€å°æƒé™åŸåˆ™ï¼š
âœ… åªç»™ç¨‹åºå®Œæˆä»»åŠ¡æ‰€éœ€çš„æœ€å°æƒé™
âœ… å®šæœŸå®¡æŸ¥å’Œæ¸…ç†ä¸éœ€è¦çš„æƒé™
âœ… ä½¿ç”¨æŠ½è±¡è§„åˆ™é¿å…é‡å¤é…ç½®

é˜²æŠ¤æ·±åº¦ç­–ç•¥ï¼š
ğŸ›¡ï¸ AppArmor + é˜²ç«å¢™ + ç”¨æˆ·æƒé™æ§åˆ¶
ğŸ›¡ï¸ å¤šå±‚å®‰å…¨æœºåˆ¶ç›¸äº’è¡¥å……
ğŸ›¡ï¸ ä¸ä¾èµ–å•ä¸€å®‰å…¨æªæ–½
```

**âš ï¸ å¸¸è§å®‰å…¨è¯¯åŒº**ï¼š
```
âŒ ä¸ºäº†æ–¹ä¾¿ç»™äºˆè¿‡å¤šæƒé™
âŒ é•¿æœŸä½¿ç”¨complainæ¨¡å¼
âŒ ä¸å®šæœŸæ›´æ–°å’Œç»´æŠ¤profile
âŒ å¿½ç•¥æ—¥å¿—å‘Šè­¦ä¿¡æ¯
```

### 8.3 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**ï¼š

```
é—®é¢˜1ï¼šç¨‹åºæ— æ³•å¯åŠ¨
æ£€æŸ¥æ­¥éª¤ï¼š
1ï¸âƒ£ ç¡®è®¤profileæ˜¯å¦æ­£ç¡®åŠ è½½
2ï¸âƒ£ æ£€æŸ¥ç¨‹åºæ‰§è¡Œæƒé™
3ï¸âƒ£ æŸ¥çœ‹AppArmoræ—¥å¿—

è§£å†³æ–¹æ³•ï¼š
sudo aa-status                    # æ£€æŸ¥çŠ¶æ€
sudo aa-complain profile_name     # ä¸´æ—¶åˆ‡æ¢æ¨¡å¼
sudo journalctl -f | grep apparmor  # æŸ¥çœ‹å®æ—¶æ—¥å¿—
```

**ğŸš¨ ç´§æ€¥å¤„ç†æ–¹æ³•**ï¼š
```bash
# ç´§æ€¥æƒ…å†µï¼šå®Œå…¨ç¦ç”¨AppArmor
sudo systemctl stop apparmor
sudo systemctl disable apparmor

# ä¸´æ—¶ç¦ç”¨ç‰¹å®šprofile
sudo aa-disable /etc/apparmor.d/usr.bin.problematic-app

# å¿«é€Ÿåˆ‡æ¢åˆ°complainæ¨¡å¼
sudo aa-complain /etc/apparmor.d/*
```

### 8.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ æ€§èƒ½è°ƒä¼˜è¦ç‚¹**ï¼š

```
é…ç½®ä¼˜åŒ–ï¼š
ğŸ”§ ä½¿ç”¨æŠ½è±¡è§„åˆ™å‡å°‘é‡å¤è§£æ
ğŸ”§ é¿å…è¿‡åº¦å¤æ‚çš„è·¯å¾„åŒ¹é…
ğŸ”§ å®šæœŸæ¸…ç†ä¸ç”¨çš„profile

ç³»ç»Ÿä¼˜åŒ–ï¼š
âš™ï¸ ç›‘æ§AppArmorå¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“
âš™ï¸ åœ¨é«˜è´Ÿè½½ç³»ç»Ÿä¸Šè€ƒè™‘æ€§èƒ½æµ‹è¯•
âš™ï¸ å¿…è¦æ—¶è°ƒæ•´profileçš„å¤æ‚åº¦
```

**ğŸ“Š æ€§èƒ½ç›‘æ§**ï¼š
```bash
# ç›‘æ§AppArmoræ€§èƒ½å½±å“
sudo systemctl status apparmor
cat /proc/sys/kernel/apparmor_stats

# åˆ†æprofileåŠ è½½æ—¶é—´
sudo apparmor_parser -T /etc/apparmor.d/usr.bin.app
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ AppArmoræœ¬è´¨ï¼šåŸºäºè·¯å¾„çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿï¼Œç»™ç¨‹åºå¥—"å®‰å…¨ç¬¼å­"
ğŸ”¸ LSMæ¶æ„ï¼šé€šè¿‡å†…æ ¸é’©å­å‡½æ•°æ‹¦æˆªå’Œæ£€æŸ¥ç³»ç»Ÿè°ƒç”¨
ğŸ”¸ è·¯å¾„æ§åˆ¶ï¼šä½¿ç”¨æ–‡ä»¶è·¯å¾„å’Œé€šé…ç¬¦å®šä¹‰è®¿é—®è§„åˆ™
ğŸ”¸ å·¥ä½œæ¨¡å¼ï¼šEnforceå¼ºåˆ¶æ‰§è¡Œï¼ŒComplainä»…è®°å½•ä¸é˜»æ­¢
ğŸ”¸ é…ç½®ç›®å½•ï¼š/etc/apparmor.d/å­˜æ”¾æ‰€æœ‰profileé…ç½®
ğŸ”¸ ç®¡ç†å‘½ä»¤ï¼šaa-statusæŸ¥çœ‹çŠ¶æ€ï¼Œaa-enforce/aa-complainåˆ‡æ¢æ¨¡å¼
ğŸ”¸ Profileè¯­æ³•ï¼šæƒé™æ ‡è®°(r,w,x)é…åˆè·¯å¾„æ¨¡å¼å®šä¹‰è®¿é—®è§„åˆ™
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ AppArmor vs ä¼ ç»Ÿæƒé™ç³»ç»Ÿ**ï¼š
```
ä¼ ç»Ÿæƒé™ï¼šåŸºäºç”¨æˆ·èº«ä»½ï¼Œrootç”¨æˆ·æƒé™è¿‡å¤§
AppArmorï¼šåŸºäºç¨‹åºè¡Œä¸ºï¼Œå³ä½¿rootè¿è¡Œçš„ç¨‹åºä¹Ÿå—é™åˆ¶

å®é™…æ•ˆæœï¼š
æ™®é€šæƒé™ï¼šrootå¯ä»¥è®¿é—®ä»»ä½•æ–‡ä»¶
AppArmorï¼šå³ä½¿rootè¿è¡Œçš„WebæœåŠ¡å™¨ä¹Ÿåªèƒ½è®¿é—®æŒ‡å®šç›®å½•
```

**ğŸ”¹ è·¯å¾„æ§åˆ¶çš„ä¼˜åŠ¿**ï¼š
```
ç›´è§‚æ˜“æ‡‚ï¼š/var/www/**ä¸€ç›®äº†ç„¶
ç»´æŠ¤ç®€å•ï¼šä¸éœ€è¦å¤æ‚çš„æ ‡ç­¾ç³»ç»Ÿ
å­¦ä¹ æˆæœ¬ä½ï¼šæ–°æ‰‹å®¹æ˜“ä¸Šæ‰‹
```

**ğŸ”¹ ä¸¤ç§æ¨¡å¼çš„ä½¿ç”¨æ—¶æœº**ï¼š
```
Complainæ¨¡å¼ï¼š
- æ–°åº”ç”¨éƒ¨ç½²æµ‹è¯•
- è°ƒè¯•profileé…ç½®
- å­¦ä¹ ç¨‹åºè¡Œä¸º

Enforceæ¨¡å¼ï¼š
- ç”Ÿäº§ç¯å¢ƒä¿æŠ¤
- ç¡®å®šçš„å®‰å…¨ç­–ç•¥
- æœ€ç»ˆéƒ¨ç½²çŠ¶æ€
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸»è¦åº”ç”¨åœºæ™¯**ï¼š
- **WebæœåŠ¡å™¨ä¿æŠ¤**ï¼šé™åˆ¶nginx/apacheåªèƒ½è®¿é—®ç½‘ç«™ç›®å½•
- **æ¡Œé¢åº”ç”¨å®‰å…¨**ï¼šé˜²æ­¢æµè§ˆå™¨ç­‰åº”ç”¨è®¿é—®æ•æ„Ÿæ–‡ä»¶
- **å®¹å™¨å®‰å…¨**ï¼šä¸ºDockerå®¹å™¨æä¾›é¢å¤–çš„å®‰å…¨å±‚
- **å¼€å‘ç¯å¢ƒ**ï¼šéš”ç¦»æµ‹è¯•ç¨‹åºï¼Œé˜²æ­¢è¯¯æ“ä½œ

**ğŸ”§ è¿ç»´å®è·µ**ï¼š
- **æ¸è¿›éƒ¨ç½²**ï¼šä»complainæ¨¡å¼é€æ­¥è¿‡æ¸¡åˆ°enforceæ¨¡å¼
- **å®šæœŸå®¡æŸ¥**ï¼šæ£€æŸ¥å’Œæ›´æ–°profileé…ç½®
- **æ—¥å¿—ç›‘æ§**ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†å®‰å…¨å‘Šè­¦
- **åº”æ€¥å¤„ç†**ï¼šæŒæ¡å¿«é€Ÿç¦ç”¨å’Œæ¢å¤çš„æ–¹æ³•

### 9.4 å­¦ä¹ è·¯å¾„å»ºè®®


```
å…¥é—¨é˜¶æ®µï¼š
ğŸ“ ç†è§£AppArmoråŸºæœ¬æ¦‚å¿µå’Œä½œç”¨
ğŸ“ å­¦ä¼šæŸ¥çœ‹çŠ¶æ€å’Œåˆ‡æ¢æ¨¡å¼
ğŸ“ æŒæ¡åŸºæœ¬çš„profileè¯­æ³•

è¿›é˜¶é˜¶æ®µï¼š
ğŸš€ èƒ½å¤Ÿä¸ºæ–°åº”ç”¨åˆ›å»ºprofile
ğŸš€ ç†è§£æŠ½è±¡è§„åˆ™çš„ä½¿ç”¨
ğŸš€ æŒæ¡æ—¥å¿—åˆ†æå’Œæ•…éšœæ’æŸ¥

é«˜çº§é˜¶æ®µï¼š
â­ è®¾è®¡å¤æ‚çš„å®‰å…¨ç­–ç•¥
â­ ä¼˜åŒ–profileæ€§èƒ½
â­ ä¸å…¶ä»–å®‰å…¨æœºåˆ¶é›†æˆ
```

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- **AppArmor = ç¨‹åºå®‰å…¨ç¬¼å­**ï¼Œé™åˆ¶ç¨‹åºèƒ½è®¿é—®çš„è·¯å¾„
- **LSM = å†…æ ¸å®‰å…¨æ’ä»¶**ï¼Œåœ¨ç³»ç»Ÿè°ƒç”¨å±‚é¢æ‹¦æˆªæ£€æŸ¥
- **è·¯å¾„è§„åˆ™ = ç®€å•ç›´è§‚**ï¼Œ/path/** rwè¿™æ ·çš„è¯­æ³•
- **ä¸¤ç§æ¨¡å¼ = æµ‹è¯•å’Œç”Ÿäº§**ï¼ŒComplainå­¦ä¹ ï¼ŒEnforceä¿æŠ¤
- **é…ç½®åœ¨/etc/apparmor.d/**ï¼Œæ–‡ä»¶åå¯¹åº”ç¨‹åºè·¯å¾„
- **aa-å‘½ä»¤ç®¡ç†profile**ï¼Œaa-statusçœ‹çŠ¶æ€ï¼Œaa-enforceè®¾æ¨¡å¼

**æ ¸å¿ƒç†å¿µ**ï¼šAppArmorè®©Linuxç³»ç»Ÿæ›´å®‰å…¨ï¼Œé€šè¿‡é™åˆ¶ç¨‹åºçš„æ–‡ä»¶è®¿é—®æƒé™ï¼Œå³ä½¿ç¨‹åºè¢«æ”»å‡»ä¹Ÿæ— æ³•é€ æˆå¤§èŒƒå›´ç ´åã€‚å®ƒçš„è·¯å¾„åŸºç¡€æ§åˆ¶æ–¹å¼ç®€å•æ˜“æ‡‚ï¼Œæ˜¯ä¿æŠ¤Linuxç³»ç»Ÿçš„é‡è¦å·¥å…·ã€‚