---
title: 8、SELinux用户角色管理
---
## 📚 目录


1. [SELinux用户基础概念](#1-selinux用户基础概念)
2. [SELinux用户与Linux用户区别](#2-selinux用户与linux用户区别)
3. [semanage user用户管理](#3-semanage-user用户管理)
4. [用户角色映射配置](#4-用户角色映射配置)
5. [unconfined_u非受限用户](#5-unconfined_u非受限用户)
6. [user_u受限用户配置](#6-user_u受限用户配置)
7. [staff_u管理员用户设置](#7-staff_u管理员用户设置)
8. [角色切换权限控制](#8-角色切换权限控制)
9. [用户安全级别配置](#9-用户安全级别配置)
10. [核心要点总结](#10-核心要点总结)

---

# 🎯 **学习路径导航**


**前置知识**：需要掌握SELinux基础概念、强制访问控制原理 → **当前内容**：SELinux用户角色管理 → **后续学习**：建议学习SELinux策略编写和自定义模块

⏱️ **预计学习时间**：本章预计90分钟 | 实践练习45分钟

🏷️ **重要性级别**：★★★★★ 系统安全核心知识

---

## 1. 👤 SELinux用户基础概念



### 1.1 什么是SELinux用户



**🔸 核心定义**
SELinux用户是强制访问控制系统中的安全主体标识，与Linux系统用户完全独立。每个SELinux用户都有特定的安全属性和权限范围。

**💡 通俗理解**
想象一个大型办公楼的门禁系统：
- **Linux用户**：就像你的员工工牌，标识你是谁
- **SELinux用户**：就像你的安全等级标识，决定你能进入哪些楼层和房间
- 同样的员工（Linux用户）可能有不同的安全等级（SELinux用户）

### 1.2 SELinux用户的安全属性



**🔍 核心属性构成**
```
SELinux安全上下文格式：
用户:角色:类型:安全级别
user:role:type:level

示例：
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
```

**📋 属性含义解释**
- **用户（User）**：安全主体身份标识
- **角色（Role）**：定义用户可以承担的角色
- **类型（Type）**：具体的安全类型标签
- **级别（Level）**：多级安全模型中的安全等级

### 1.3 SELinux用户类型概览



| **用户类型** | **权限范围** | **典型应用** | **安全等级** |
|-------------|-------------|-------------|-------------|
| **unconfined_u** | 不受限制 | 普通桌面用户 | ⭐⭐ |
| **user_u** | 严格受限 | 受限制的用户 | ⭐⭐⭐⭐ |
| **staff_u** | 中等权限 | 系统管理员 | ⭐⭐⭐ |
| **system_u** | 系统级别 | 系统进程 | ⭐⭐⭐⭐⭐ |

---

## 2. 🔄 SELinux用户与Linux用户区别



### 2.1 身份标识层面差异



**🔸 Linux用户特点**
Linux用户主要用于系统资源访问控制，基于UID和GID进行权限管理。

```bash
# Linux用户信息查看

id username
# 输出：uid=1000(alice) gid=1000(alice) groups=1000(alice),4(adm)

```

**🔸 SELinux用户特点**
SELinux用户用于强制访问控制，基于安全策略进行权限管理。

```bash
# SELinux用户身份查看

id -Z
# 输出：unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

```

### 2.2 权限管理模式对比



**📊 权限模型差异**

```
传统Linux权限模型（DAC）：
用户 → 组 → 其他用户
rwx    rwx    rwx

SELinux权限模型（MAC）：
主体 → 客体 → 操作
允许/拒绝基于安全策略决定
```

**💡 理解差异的关键**
- **Linux用户**：关注"谁"可以访问资源
- **SELinux用户**：关注"什么身份"在"什么情况下"可以访问

### 2.3 映射关系管理



**🔗 用户映射机制**
每个Linux用户都会映射到一个SELinux用户，这种映射关系决定了用户的安全权限范围。

```bash
# 查看当前用户映射关系

semanage login -l
# 输出示例：

# Login Name     SELinux User     MLS/MCS Range

# __default__    unconfined_u     s0-s0:c0.c1023

# alice          user_u           s0

# root           unconfined_u     s0-s0:c0.c1023

```

---

## 3. 🛠️ semanage user用户管理



### 3.1 semanage工具基础



**🔧 工具介绍**
`semanage`是SELinux策略管理的核心工具，用于配置用户、角色、端口等安全策略元素。

```bash
# 检查semanage是否安装

which semanage

# 如果未安装，需要安装策略管理工具

sudo dnf install policycoreutils-python-utils  # RHEL/CentOS
sudo apt install policycoreutils-python-utils  # Ubuntu
```

### 3.2 SELinux用户查看和管理



**👀 查看现有SELinux用户**
```bash
# 列出所有SELinux用户

semanage user -l

# 详细输出解释：

# SELinux User    Prefix   MCS Level  MCS Range           Roles

# root            user     s0         s0-s0:c0.c1023      system_r unconfined_r

# system_u        user     s0         s0-s0:c0.c1023      system_r

# unconfined_u    user     s0         s0-s0:c0.c1023      system_r unconfined_r

# user_u          user     s0         s0                   user_r

```

**➕ 创建自定义SELinux用户**
```bash
# 创建受限的业务用户

sudo semanage user -a -R "user_r" -r s0 business_u

# 参数解释：

# -a: 添加用户

# -R: 指定角色（可多个）

# -r: 指定MLS安全级别

# business_u: 新用户名

```

### 3.3 用户属性修改和删除



**✏️ 修改用户属性**
```bash
# 修改用户可用角色

sudo semanage user -m -R "user_r staff_r" business_u

# 修改用户安全级别范围

sudo semanage user -m -r s0-s2 business_u
```

**🗑️ 删除用户**
```bash
# 删除自定义SELinux用户

sudo semanage user -d business_u

# ⚠️ 注意：删除前确保没有Linux用户映射到此SELinux用户

```

---

## 4. 🔗 用户角色映射配置



### 4.1 映射关系基础



**📝 映射配置原理**
每个Linux用户登录时，系统会根据映射配置为其分配相应的SELinux用户身份，从而确定其安全权限范围。

### 4.2 查看和管理映射关系



**🔍 查看现有映射**
```bash
# 查看所有登录用户映射

semanage login -l

# 查看特定用户映射

semanage login -l | grep alice
```

**⚙️ 配置用户映射**
```bash
# 将Linux用户alice映射到受限用户

sudo semanage login -a -s user_u alice

# 将Linux用户bob映射到管理员用户

sudo semanage login -a -s staff_u bob

# 修改现有映射

sudo semanage login -m -s user_u -r s0 alice
```

### 4.3 默认映射策略



**🎯 默认映射机制**
```bash
# 查看默认映射（__default__）

semanage login -l | grep __default__

# 修改默认映射策略

sudo semanage login -m -s user_u __default__

# 这会影响所有未明确映射的新用户

```

**💡 映射策略建议**
- **桌面用户**：使用`unconfined_u`获得较大灵活性
- **服务器用户**：使用`user_u`提供严格限制
- **管理员**：使用`staff_u`平衡权限和安全性

---

## 5. 🔓 unconfined_u非受限用户



### 5.1 非受限用户特性



**🔸 核心特点**
`unconfined_u`是SELinux中权限最宽泛的用户类型，主要用于桌面环境和开发场景，提供类似传统Linux的使用体验。

**📋 权限范围**
- 可以运行大多数应用程序
- 能够切换到其他角色（如system_r）
- 对文件系统访问限制较少
- 网络访问权限较宽松

### 5.2 unconfined_u的角色配置



**👁️ 查看角色信息**
```bash
# 查看unconfined_u可用角色

semanage user -l | grep unconfined_u

# 典型输出：

# unconfined_u    user    s0    s0-s0:c0.c1023    system_r unconfined_r

```

**⚙️ 角色权限说明**
- **unconfined_r**：日常操作角色，权限宽松
- **system_r**：系统管理角色，可执行管理任务

### 5.3 适用场景和注意事项



**✅ 适合使用场景**
- 桌面开发环境
- 图形界面用户
- 需要运行多样化软件的场景
- 学习和测试环境

**⚠️ 安全风险提醒**
虽然名为"非受限"，但仍受SELinux策略约束，只是限制相对较少。在生产环境中需要谨慎使用。

---

## 6. 🔒 user_u受限用户配置



### 6.1 受限用户特性



**🛡️ 严格安全控制**
`user_u`提供严格的访问控制，适用于需要高安全性的环境，用户只能执行被明确允许的操作。

**📊 权限限制清单**
- ❌ 不能执行`su`或`sudo`命令
- ❌ 不能运行网络服务程序
- ❌ 不能修改系统配置文件
- ❌ 不能访问敏感系统目录
- ✅ 只能运行用户域允许的程序

### 6.2 配置受限用户



**👤 创建受限用户映射**
```bash
# 创建Linux用户

sudo useradd restricteduser

# 映射到user_u

sudo semanage login -a -s user_u restricteduser

# 设置用户密码

sudo passwd restricteduser
```

**🧪 测试受限效果**
```bash
# 切换到受限用户

su - restricteduser

# 尝试执行受限操作（应该被拒绝）

sudo ls /root  # 被拒绝
ping google.com  # 可能被拒绝（取决于策略）
```

### 6.3 受限用户权限调整



**📝 允许特定操作**
如果需要为受限用户开放某些权限，可以通过布尔值调整：

```bash
# 查看用户相关的布尔值

getsebool -a | grep user

# 允许用户执行网络连接

sudo setsebool -P user_tcp_server 1

# 允许用户读取用户家目录

sudo setsebool -P user_read_other_files 1
```

---

## 7. ⚡ staff_u管理员用户设置



### 7.1 管理员用户特性



**🎯 平衡权限设计**
`staff_u`介于`unconfined_u`和`user_u`之间，为系统管理员提供必要的管理权限，同时保持一定的安全约束。

**🔑 核心能力**
- 可以使用`sudo`提升权限
- 能够切换到管理角色
- 可以执行系统管理任务
- 对网络和文件系统有合理访问权限

### 7.2 配置管理员用户



**👨‍💼 设置管理员映射**
```bash
# 创建管理员Linux用户

sudo useradd adminuser

# 映射到staff_u

sudo semanage login -a -s staff_u adminuser

# 添加到sudo组

sudo usermod -a -G wheel adminuser  # RHEL/CentOS
sudo usermod -a -G sudo adminuser   # Ubuntu

# 设置密码

sudo passwd adminuser
```

### 7.3 管理员角色切换



**🔄 角色切换机制**
staff_u用户可以在不同角色间切换，以执行不同类型的任务：

```bash
# 查看当前角色

id -Z

# 切换到系统管理角色

newrole -r system_r

# 切换回普通用户角色

newrole -r staff_r
```

**💡 角色切换的实际意义**
- **staff_r**：日常办公操作
- **system_r**：系统维护和配置
- **sysadm_r**：高级系统管理（如果可用）

---

## 8. 🔀 角色切换权限控制



### 8.1 角色切换基础



**🔸 角色切换概念**
角色切换允许用户在授权范围内改变自己的SELinux角色，从而获得执行特定任务所需的权限。

**🔧 切换工具使用**
```bash
# 使用newrole切换角色

newrole -r target_role

# 查看可切换的角色

semanage user -l | grep $(whoami)
```

### 8.2 配置角色切换权限



**⚙️ 权限配置方法**
角色切换权限在用户定义时确定，通过`-R`参数指定可用角色：

```bash
# 创建可切换多角色的用户

sudo semanage user -a -R "user_r staff_r system_r" multiroll_u

# 修改现有用户的角色权限

sudo semanage user -m -R "staff_r sysadm_r" staff_u
```

### 8.3 角色切换安全策略



**🛡️ 安全考量**
- **最小权限原则**：只授予必要的角色切换权限
- **审计跟踪**：角色切换操作会被记录在审计日志中
- **会话隔离**：不同角色的操作在不同的安全上下文中执行

**📝 审计角色切换**
```bash
# 查看角色切换日志

sudo ausearch -m USER_ROLE_CHANGE

# 查看用户登录和角色变化

sudo ausearch -m USER_LOGIN -m USER_ROLE_CHANGE
```

---

## 9. 🏷️ 用户安全级别配置



### 9.1 多级安全(MLS)基础



**🔸 安全级别概念**
MLS(Multi-Level Security)提供分级的信息安全保护，每个用户和对象都有安全级别标识。

**📊 安全级别结构**
```
安全级别格式：s[level][:category_set]

示例：
s0          # 最低安全级别
s0:c0,c1    # 带分类的安全级别
s0-s3       # 安全级别范围
s0-s3:c0.c1023  # 完整的级别范围
```

### 9.2 配置用户安全级别



**⚙️ 设置用户MLS范围**
```bash
# 设置用户的安全级别范围

sudo semanage user -m -r s0-s2:c0.c100 staff_u

# 为特定用户设置固定级别

sudo semanage login -m -r s1:c0,c1 sensitiveuser
```

**🔍 查看安全级别配置**
```bash
# 查看所有用户的安全级别

semanage user -l | awk '{print $1,$4}'

# 查看当前用户的安全级别

id -Z | cut -d: -f4
```

### 9.3 安全级别应用场景



**🎯 实际应用示例**
- **s0**：公开信息级别
- **s1**：内部信息级别  
- **s2**：机密信息级别
- **s3**：绝密信息级别

**📋 级别控制原则**
- **向上读取**：低级别用户不能读取高级别信息
- **向下写入**：高级别用户不能向低级别写入信息
- **同级访问**：相同级别间可以正常访问

---

## 10. 📋 核心要点总结



### 10.1 必须掌握的核心概念



```
🔸 SELinux用户：独立于Linux用户的安全身份标识系统
🔸 用户映射：Linux用户到SELinux用户的对应关系
🔸 角色切换：用户在不同安全角色间的身份转换机制
🔸 安全级别：多级安全模型中的信息分级保护
🔸 权限模型：基于策略的强制访问控制机制
```

### 10.2 关键理解要点



**🔹 为什么需要SELinux用户**
```
传统权限模型的局限：
- 基于文件所有者的自主访问控制
- 无法防范内部威胁和权限滥用
- 缺乏细粒度的访问控制

SELinux用户的优势：
- 强制访问控制，不受文件所有者限制
- 基于安全策略的访问决策
- 多层次的安全防护机制
```

**🔹 用户类型选择策略**
```
环境分析：
- 桌面环境 → unconfined_u（便利性优先）
- 服务器环境 → user_u（安全性优先）
- 管理场景 → staff_u（平衡权限和安全）
- 系统服务 → system_u（系统级别控制）
```

### 10.3 实际应用价值



**🎯 企业安全场景**
- **多用户系统**：不同用户获得不同的安全权限
- **特权分离**：管理员权限细化分级
- **信息分类**：敏感数据的分级保护
- **合规要求**：满足安全认证标准

**🛠️ 配置最佳实践**
```
用户映射策略：
- 普通用户使用user_u限制权限
- 管理员使用staff_u平衡功能
- 特殊需求用户创建自定义SELinux用户
- 定期审查用户映射关系

安全级别管理：
- 根据信息敏感度设置级别
- 实施最小权限原则
- 建立级别变更审批流程
- 监控跨级别访问行为
```

### 10.4 学习检查清单



**📝 知识掌握验证**
- [ ] 理解SELinux用户与Linux用户的区别
- [ ] 掌握semanage user命令的使用
- [ ] 能够配置用户角色映射关系
- [ ] 了解不同用户类型的权限特点
- [ ] 会进行角色切换操作
- [ ] 理解多级安全模型的应用

**🔧 实践技能检查**
- [ ] 能创建自定义SELinux用户
- [ ] 会配置受限用户权限
- [ ] 能设置管理员用户映射
- [ ] 掌握安全级别配置方法
- [ ] 能排查用户权限问题

**🔑 核心记忆要点**
> SELinux用户管安全，映射配置是关键
> 三类用户各不同，角色切换要谨慎
> 安全级别分等级，权限控制更精细

**💡 进阶学习建议**
- 深入学习SELinux策略语言
- 研究自定义安全模块开发
- 了解SELinux在容器环境中的应用
- 学习SELinux故障排除和性能优化

**⚠️ 常见误区提醒**
- SELinux用户不等于Linux用户，两者独立存在
- 角色切换需要明确的策略授权，不是随意切换
- 安全级别的设置需要综合考虑业务需求和安全要求
- unconfined_u虽然"非受限"，但仍受SELinux策略约束