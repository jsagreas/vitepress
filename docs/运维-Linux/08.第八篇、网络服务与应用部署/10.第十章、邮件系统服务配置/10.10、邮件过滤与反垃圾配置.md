---
title: 10ã€é‚®ä»¶è¿‡æ»¤ä¸ååƒåœ¾é…ç½®
---
## ğŸ“š ç›®å½•

1. [é‚®ä»¶è¿‡æ»¤åŸºç¡€æ¦‚å¿µ](#1-é‚®ä»¶è¿‡æ»¤åŸºç¡€æ¦‚å¿µ)
2. [Postfixå†…ç½®è¿‡æ»¤æœºåˆ¶](#2-Postfixå†…ç½®è¿‡æ»¤æœºåˆ¶)
3. [SpamAssassinåƒåœ¾é‚®ä»¶æ£€æµ‹](#3-SpamAssassinåƒåœ¾é‚®ä»¶æ£€æµ‹)
4. [Amavisd-newå†…å®¹è¿‡æ»¤å™¨](#4-Amavisd-newå†…å®¹è¿‡æ»¤å™¨)
5. [ClamAVç—…æ¯’æ‰«æé›†æˆ](#5-ClamAVç—…æ¯’æ‰«æé›†æˆ)
6. [åƒåœ¾é‚®ä»¶è¯„åˆ†ä¸ç­–ç•¥](#6-åƒåœ¾é‚®ä»¶è¯„åˆ†ä¸ç­–ç•¥)
7. [ç™½åå•ä¸é»‘åå•ç®¡ç†](#7-ç™½åå•ä¸é»‘åå•ç®¡ç†)
8. [è‡ªåŠ¨å¤„ç†è§„åˆ™é…ç½®](#8-è‡ªåŠ¨å¤„ç†è§„åˆ™é…ç½®)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“§ é‚®ä»¶è¿‡æ»¤åŸºç¡€æ¦‚å¿µ


### 1.1 é‚®ä»¶è¿‡æ»¤çš„æœ¬è´¨


**ä»€ä¹ˆæ˜¯é‚®ä»¶è¿‡æ»¤ï¼Ÿ**
```
é‚®ä»¶è¿‡æ»¤å°±åƒé—¨å«æ£€æŸ¥åŒ…è£¹ï¼š
ğŸ“¦ æ”¶åˆ°é‚®ä»¶ â†’ ğŸ” æ£€æŸ¥å†…å®¹ â†’ âœ… æ”¾è¡Œæˆ– âŒ æ‹¦æˆª

æ ¸å¿ƒç›®æ ‡ï¼š
â€¢ é˜»æ­¢åƒåœ¾é‚®ä»¶è¿›å…¥ç”¨æˆ·é‚®ç®±
â€¢ æ£€æµ‹å¹¶éš”ç¦»ç—…æ¯’é‚®ä»¶
â€¢ ç¡®ä¿æ­£å¸¸é‚®ä»¶é¡ºåˆ©æŠ•é€’
â€¢ å‡å°‘æœåŠ¡å™¨èµ„æºæµªè´¹
```

### 1.2 é‚®ä»¶è¿‡æ»¤çš„å·¥ä½œå±‚æ¬¡


**è¿‡æ»¤æ£€æŸ¥æµç¨‹å›¾**ï¼š
```
å¤–éƒ¨é‚®ä»¶æŠ•é€’æµç¨‹ï¼š

å‘ä»¶æœåŠ¡å™¨ â†’ [ç½‘ç»œå±‚è¿‡æ»¤] â†’ [è¿æ¥å±‚æ£€æŸ¥] â†’ [SMTPä¼šè¯æ£€æŸ¥] 
     â†“
[å¤´éƒ¨æ£€æŸ¥] â†’ [å†…å®¹æ£€æŸ¥] â†’ [ç—…æ¯’æ‰«æ] â†’ [åƒåœ¾é‚®ä»¶è¯„åˆ†]
     â†“
[ç™½åå•æ£€æŸ¥] â†’ [æœ€ç»ˆå†³ç­–] â†’ æŠ•é€’/æ‹’ç»/éš”ç¦»
```

**ğŸ”¸ æ£€æŸ¥å±‚æ¬¡è¯´æ˜**ï¼š
- **è¿æ¥å±‚**ï¼šæ£€æŸ¥å‘ä»¶æœåŠ¡å™¨IPã€åŸŸåå£°èª‰
- **åè®®å±‚**ï¼šSMTPå‘½ä»¤åˆæ³•æ€§æ£€æŸ¥
- **å¤´éƒ¨å±‚**ï¼šé‚®ä»¶å¤´éƒ¨å­—æ®µæ ¼å¼å’Œå†…å®¹æ£€æŸ¥
- **å†…å®¹å±‚**ï¼šé‚®ä»¶æ­£æ–‡å’Œé™„ä»¶å†…å®¹åˆ†æ
- **ç»¼åˆå±‚**ï¼šå¤šç§æ£€æµ‹ç»“æœç»¼åˆè¯„åˆ¤

### 1.3 å¸¸è§å¨èƒç±»å‹


**ğŸ“Š é‚®ä»¶å¨èƒåˆ†ç±»**ï¼š

| å¨èƒç±»å‹ | **ç‰¹å¾** | **å±å®³** | **æ£€æµ‹æ–¹æ³•** |
|---------|---------|----------|-------------|
| ğŸ—‘ï¸ **åƒåœ¾é‚®ä»¶** | `æ¨å¹¿å†…å®¹ã€æ‰¹é‡å‘é€` | `å ç”¨èµ„æºã€å½±å“ç”¨æˆ·ä½“éªŒ` | `å…³é”®è¯ã€å‘é€æ¨¡å¼åˆ†æ` |
| ğŸ¦  **ç—…æ¯’é‚®ä»¶** | `æ¶æ„é™„ä»¶ã€å¯æ‰§è¡Œæ–‡ä»¶` | `ç³»ç»Ÿæ„ŸæŸ“ã€æ•°æ®æŸå¤±` | `æ–‡ä»¶æ‰«æã€è¡Œä¸ºåˆ†æ` |
| ğŸ£ **é’“é±¼é‚®ä»¶** | `ä¼ªé€ èº«ä»½ã€è¯±å¯¼ç‚¹å‡»` | `ä¿¡æ¯æ³„éœ²ã€è´¢äº§æŸå¤±` | `é“¾æ¥åˆ†æã€åŸŸåæ£€æŸ¥` |
| ğŸ’£ **æœ¨é©¬é‚®ä»¶** | `éšè”½åé—¨ã€è¿œç¨‹æ§åˆ¶` | `ç³»ç»Ÿå…¥ä¾µã€éšç§æ³„éœ²` | `ä»£ç åˆ†æã€æ²™ç®±æ£€æµ‹` |

---

## 2. ğŸ”§ Postfixå†…ç½®è¿‡æ»¤æœºåˆ¶


### 2.1 header_checkså¤´éƒ¨æ£€æŸ¥


**å¤´éƒ¨æ£€æŸ¥çš„ä½œç”¨**ï¼š
```
header_checkså°±åƒæ£€æŸ¥ä¿¡å°ä¸Šçš„åœ°å€ï¼š
ğŸ“® æ£€æŸ¥å‘ä»¶äººã€æ”¶ä»¶äººã€ä¸»é¢˜ç­‰ä¿¡æ¯
ğŸ” å‘ç°å¯ç–‘å†…å®¹ç«‹å³æ‹’ç»
âš¡ åœ¨é‚®ä»¶è¿›å…¥ç³»ç»Ÿå‰å°±è¿‡æ»¤æ‰åƒåœ¾
```

**é…ç½®ç¤ºä¾‹**ï¼š
```bash
# /etc/postfix/main.cf
header_checks = regexp:/etc/postfix/header_checks

# /etc/postfix/header_checks
/^Subject:.*\[SPAM\]/    REJECT åƒåœ¾é‚®ä»¶è¢«æ‹’ç»
/^From:.*@spam-domain\.com/    REJECT å‘ä»¶äººåœ¨é»‘åå•ä¸­
/^X-Mailer: Mass Mailer/    REJECT æ‰¹é‡é‚®ä»¶è½¯ä»¶
```

**ğŸ”¸ å¸¸ç”¨æ£€æŸ¥è§„åˆ™**ï¼š
```
ä¸»é¢˜æ£€æŸ¥ï¼š
/^Subject:.*(?:èµ¢å–|ä¸­å¥–|å…è´¹|ä¼˜æƒ )/    REJECT

å‘ä»¶äººæ£€æŸ¥ï¼š
/^From:.*noreply@.*\.cn$/    WARN å¯ç–‘å‘ä»¶äºº

é‚®ä»¶å®¢æˆ·ç«¯æ£€æŸ¥ï¼š
/^X-Mailer: .*spam/i    REJECT åƒåœ¾é‚®ä»¶å·¥å…·
```

### 2.2 body_checkså†…å®¹æ£€æŸ¥


**å†…å®¹æ£€æŸ¥çš„åŸç†**ï¼š
```
body_checksåƒæ£€æŸ¥åŒ…è£¹å†…å®¹ç‰©ï¼š
ğŸ“¦ æ‰«æé‚®ä»¶æ­£æ–‡å†…å®¹
ğŸ” æŸ¥æ‰¾å¯ç–‘å…³é”®è¯å’Œæ¨¡å¼
ğŸš« å‘ç°è¿è§„å†…å®¹ç«‹å³å¤„ç†
```

**é…ç½®æ–¹æ³•**ï¼š
```bash
# /etc/postfix/main.cf
body_checks = regexp:/etc/postfix/body_checks

# /etc/postfix/body_checks
/ç‚¹å‡»è¿™é‡Œé¢†å–å¥–å“/    REJECT å¯ç–‘é“¾æ¥å†…å®¹
/urgent.*transfer.*money/i    REJECT è¯ˆéª—é‚®ä»¶æ¨¡å¼
/\bhref=.*suspicious-site\.com/    REJECT æ¶æ„é“¾æ¥
```

**âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹**ï¼š
```
ä¼˜ç‚¹ï¼š
âœ… å¤„ç†é€Ÿåº¦å¿«ï¼Œèµ„æºå ç”¨å°‘
âœ… å¯è‡ªå®šä¹‰è§„åˆ™ï¼Œçµæ´»åº¦é«˜
âœ… åœ¨æŠ•é€’å‰æ‹¦æˆªï¼ŒèŠ‚çœèµ„æº

é™åˆ¶ï¼š
âŒ åªèƒ½åšç®€å•æ¨¡å¼åŒ¹é…
âŒ æ— æ³•å¤„ç†å¤æ‚çš„åƒåœ¾é‚®ä»¶
âŒ å®¹æ˜“è¯¯åˆ¤æ­£å¸¸é‚®ä»¶
```

### 2.3 SMTPé™åˆ¶æœºåˆ¶


**è¿æ¥å±‚è¿‡æ»¤**ï¼š
```bash
# é™åˆ¶åŒæ—¶è¿æ¥æ•°
smtpd_client_connection_count_limit = 50

# é™åˆ¶è¿æ¥é€Ÿç‡
smtpd_client_connection_rate_limit = 30

# æ£€æŸ¥å®¢æˆ·ç«¯ä¸»æœºå
smtpd_client_restrictions = 
    permit_mynetworks,
    reject_unknown_client_hostname,
    permit
```

---

## 3. ğŸ›¡ï¸ SpamAssassinåƒåœ¾é‚®ä»¶æ£€æµ‹


### 3.1 SpamAssassinå·¥ä½œåŸç†


**ä»€ä¹ˆæ˜¯SpamAssassinï¼Ÿ**
```
SpamAssassinæ˜¯ä¸“ä¸šçš„åƒåœ¾é‚®ä»¶æ£€æµ‹å·¥å…·ï¼š
ğŸ§  ä½¿ç”¨å¤šç§ç®—æ³•åˆ†æé‚®ä»¶ç‰¹å¾
ğŸ“Š ç»™é‚®ä»¶æ‰“åˆ†ï¼Œåˆ†æ•°è¶Šé«˜è¶Šåƒåƒåœ¾é‚®ä»¶
ğŸ¯ åŸºäºè´å¶æ–¯è¿‡æ»¤å™¨å’Œè§„åˆ™å¼•æ“
```

**æ£€æµ‹æœºåˆ¶å›¾è§£**ï¼š
```
é‚®ä»¶è¾“å…¥ â†’ [è´å¶æ–¯è¿‡æ»¤] â†’ [è§„åˆ™åŒ¹é…] â†’ [ç½‘ç»œæ£€æŸ¥] â†’ ç»¼åˆè¯„åˆ†
    â†“           â†“           â†“           â†“
  è¯é¢‘åˆ†æ    æ¨¡å¼åŒ¹é…    é»‘åå•æŸ¥è¯¢   DNSæŸ¥è¯¢
    â†“           â†“           â†“           â†“
   å¾—åˆ†A       å¾—åˆ†B       å¾—åˆ†C       å¾—åˆ†D
    â†“           â†“           â†“           â†“
         æœ€ç»ˆå¾—åˆ† = A + B + C + D
```

### 3.2 å®‰è£…é…ç½®SpamAssassin


**å®‰è£…æ­¥éª¤**ï¼š
```bash
# å®‰è£…SpamAssassin
sudo apt-get install spamassassin spamc

# å¯åŠ¨æœåŠ¡
sudo systemctl enable spamassassin
sudo systemctl start spamassassin
```

**åŸºç¡€é…ç½®**ï¼š
```bash
# /etc/spamassassin/local.cf
# åƒåœ¾é‚®ä»¶é˜ˆå€¼ï¼ˆ5åˆ†ä»¥ä¸Šè®¤ä¸ºæ˜¯åƒåœ¾é‚®ä»¶ï¼‰
required_score 5.0

# é‡å†™ä¸»é¢˜è¡Œ
rewrite_header Subject [SPAM]

# æ·»åŠ åƒåœ¾é‚®ä»¶æ ‡è®°å¤´
add_header all Status _YESNO_, score=_SCORE_ required=_REQD_

# å¯ç”¨è´å¶æ–¯è¿‡æ»¤å™¨
use_bayes 1
bayes_auto_learn 1
```

### 3.3 ä¸Postfixé›†æˆ


**é›†æˆé…ç½®**ï¼š
```bash
# /etc/postfix/main.cf
# å¯ç”¨å†…å®¹è¿‡æ»¤å™¨
content_filter = spamassassin

# /etc/postfix/master.cf
# æ·»åŠ SpamAssassinè¿‡æ»¤å™¨
spamassassin unix -     n       n       -       -       pipe
  user=spamd argv=/usr/bin/spamc -f -e  
  /usr/sbin/sendmail -oi -f ${sender} ${recipient}
```

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–**ï¼š
```bash
# é…ç½®spamdå®ˆæŠ¤è¿›ç¨‹
# /etc/default/spamassassin
ENABLED=1
SPAMD_HOME="/var/lib/spamassassin/"
OPTIONS="--create-prefs --max-children 5 --helper-home-dir"
PIDFILE="/var/run/spamd.pid"
```

---

## 4. ğŸ”„ Amavisd-newå†…å®¹è¿‡æ»¤å™¨


### 4.1 Amavisd-newç®€ä»‹


**ä»€ä¹ˆæ˜¯Amavisd-newï¼Ÿ**
```
Amavisd-newæ˜¯é‚®ä»¶å†…å®¹è¿‡æ»¤çš„ä¸­å¤®æ¢çº½ï¼š
ğŸ”€ è¿æ¥å¤šä¸ªæ£€æµ‹å·¥å…·
ğŸ›ï¸ ç»Ÿä¸€ç®¡ç†è¿‡æ»¤ç­–ç•¥
ğŸ“‹ è®°å½•è¯¦ç»†çš„è¿‡æ»¤æ—¥å¿—
ğŸ”§ æ”¯æŒå¤æ‚çš„å¤„ç†è§„åˆ™
```

**æ¶æ„å›¾è§£**ï¼š
```
Postfix â†’ Amavisd-new â†’ [SpamAssassin] â†’ Postfix
             â†“              â†“
         [ClamAV]      [è‡ªå®šä¹‰è§„åˆ™]
             â†“              â†“
        ç—…æ¯’æ£€æµ‹        ç­–ç•¥å†³ç­–
```

### 4.2 å®‰è£…é…ç½®Amavisd-new


**å®‰è£…è¿‡ç¨‹**ï¼š
```bash
# å®‰è£…Amavisd-new
sudo apt-get install amavisd-new

# åˆ›å»ºç”¨æˆ·å’Œç›®å½•
sudo adduser --system --group --home /var/lib/amavis amavis
sudo mkdir -p /var/lib/amavis/tmp
sudo chown amavis:amavis /var/lib/amavis/tmp
```

**æ ¸å¿ƒé…ç½®**ï¼š
```perl
# /etc/amavis/conf.d/20-debian_defaults
use strict;

# ç›‘å¬åœ°å€å’Œç«¯å£
$inet_socket_port = 10024;
$inet_socket_bind = '127.0.0.1';

# æœ€å¤§é‚®ä»¶å¤§å° (20MB)
$max_servers = 5;
$max_requests = 20;

# å¯ç”¨åƒåœ¾é‚®ä»¶æ£€æŸ¥
$sa_tag_level_deflt = -999;  # æ€»æ˜¯æ·»åŠ åƒåœ¾é‚®ä»¶å¤´
$sa_tag2_level_deflt = 5.0;  # æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶çš„é˜ˆå€¼
$sa_kill_level_deflt = 8.0;  # æ‹’ç»é‚®ä»¶çš„é˜ˆå€¼

# å¯ç”¨ç—…æ¯’æ£€æŸ¥
$virus_admin = 'admin@yourdomain.com';
```

### 4.3 ä¸Postfixé›†æˆé…ç½®


**Postfixé…ç½®ä¿®æ”¹**ï¼š
```bash
# /etc/postfix/main.cf
content_filter = amavis:[127.0.0.1]:10024

# /etc/postfix/master.cf
# æ·»åŠ AmavisæœåŠ¡
amavis      unix    -       -       -       -       2       smtp
    -o smtp_data_done_timeout=1200
    -o smtp_send_xforward_command=yes

# å›æ³¨å…¥æœåŠ¡
127.0.0.1:10025 inet    n       -       -       -       -       smtpd
    -o content_filter=
    -o local_recipient_maps=
    -o relay_recipient_maps=
    -o smtpd_restriction_classes=
    -o smtpd_client_restrictions=permit_mynetworks,reject
    -o smtpd_helo_restrictions=
    -o smtpd_sender_restrictions=
    -o smtpd_recipient_restrictions=permit_mynetworks,reject
    -o mynetworks=127.0.0.0/8
    -o strict_rfc821_envelopes=yes
```

---

## 5. ğŸ¦  ClamAVç—…æ¯’æ‰«æé›†æˆ


### 5.1 ClamAVç—…æ¯’æ‰«æåŸç†


**ClamAVå·¥ä½œæœºåˆ¶**ï¼š
```
ClamAVå°±åƒä¸“ä¸šçš„ç—…æ¯’æ£€æµ‹ä»ªï¼š
ğŸ” æ‰«æé‚®ä»¶é™„ä»¶å’Œå†…å®¹
ğŸ“š ä½¿ç”¨ç—…æ¯’ç‰¹å¾åº“æ¯”å¯¹
ğŸš¨ å‘ç°ç—…æ¯’ç«‹å³æŠ¥è­¦
ğŸ”„ å®šæœŸæ›´æ–°ç—…æ¯’åº“
```

### 5.2 å®‰è£…é…ç½®ClamAV


**å®‰è£…æ­¥éª¤**ï¼š
```bash
# å®‰è£…ClamAV
sudo apt-get install clamav clamav-daemon clamav-freshclam

# æ›´æ–°ç—…æ¯’åº“
sudo freshclam

# å¯åŠ¨æœåŠ¡
sudo systemctl enable clamav-daemon
sudo systemctl start clamav-daemon
```

**é…ç½®æ–‡ä»¶**ï¼š
```bash
# /etc/clamav/clamd.conf
LocalSocket /var/run/clamav/clamd.ctl
FixStaleSocket true
User clamav
AllowSupplementaryGroups true

# æœ€å¤§æ‰«æå¤§å°
MaxScanSize 100M
MaxFileSize 25M
MaxRecursion 16
MaxFiles 10000

# æ‰«æé€‰é¡¹
ScanPE true
ScanELF true
ScanOLE2 true
ScanPDF true
ScanHTML true
```

### 5.3 ä¸Amavisdé›†æˆ


**é›†æˆé…ç½®**ï¼š
```perl
# /etc/amavis/conf.d/15-content_filter_mode
use strict;

# å¯ç”¨ç—…æ¯’æ‰«æ
@bypass_virus_checks_maps = (
   \%bypass_virus_checks, \@bypass_virus_checks_acl, \$bypass_virus_checks_re);

# ClamAVæ‰«æå™¨é…ç½®
['ClamAV-clamd',
  \&ask_daemon, ["CONTSCAN {}\n", "/var/run/clamav/clamd.ctl"],
  qr/\bOK$/m, qr/\bFOUND$/m,
  qr/^.*?: (?!Infected Archive)(.*) FOUND$/m ],
```

**ğŸ›¡ï¸ ç—…æ¯’å¤„ç†ç­–ç•¥**ï¼š
```perl
# ç—…æ¯’é‚®ä»¶å¤„ç†
$final_virus_destiny = D_DISCARD;  # ä¸¢å¼ƒç—…æ¯’é‚®ä»¶
$virus_quarantine_to = 'virus-quarantine';  # éš”ç¦»ä½ç½®
```

---

## 6. ğŸ“Š åƒåœ¾é‚®ä»¶è¯„åˆ†ä¸ç­–ç•¥


### 6.1 è¯„åˆ†æœºåˆ¶è¯¦è§£


**SpamAssassinè¯„åˆ†åŸç†**ï¼š
```
åƒåœ¾é‚®ä»¶è¯„åˆ†å°±åƒè€ƒè¯•æ‰“åˆ†ï¼š
ğŸ“ æ¯é¡¹æ£€æŸ¥ç»™å‡ºåˆ†æ•°
â• ç´¯åŠ æ‰€æœ‰æ£€æŸ¥åˆ†æ•°
ğŸ¯ è¶…è¿‡é˜ˆå€¼åˆ¤å®šä¸ºåƒåœ¾é‚®ä»¶
```

**è¯„åˆ†è§„åˆ™ç¤ºä¾‹**ï¼š
```
å…¸å‹è¯„åˆ†é¡¹ç›®ï¼š
ğŸ“§ ä¸»é¢˜åŒ…å«"ä¸­å¥–"ï¼š+2.0åˆ†
ğŸ“§ å‘ä»¶äººIPåœ¨é»‘åå•ï¼š+5.0åˆ†  
ğŸ“§ åŒ…å«å¯ç–‘é“¾æ¥ï¼š+3.0åˆ†
ğŸ“§ HTMLæ ¼å¼å¼‚å¸¸ï¼š+1.5åˆ†
ğŸ“§ è´å¶æ–¯è¿‡æ»¤å™¨åˆ¤æ–­ï¼š+4.0åˆ†

æ€»åˆ†ï¼š15.5åˆ† â†’ è¶…è¿‡5åˆ†é˜ˆå€¼ â†’ åˆ¤å®šä¸ºåƒåœ¾é‚®ä»¶
```

### 6.2 è‡ªå®šä¹‰è¯„åˆ†è§„åˆ™


**åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™**ï¼š
```bash
# /etc/spamassassin/local.cf
# è‡ªå®šä¹‰è§„åˆ™
header LOCAL_SUSPICIOUS_SUBJECT Subject =~ /(?:ç´§æ€¥|é™æ—¶|æœºä¼š)/i
describe LOCAL_SUSPICIOUS_SUBJECT å¯ç–‘ä¸»é¢˜è¯æ±‡
score LOCAL_SUSPICIOUS_SUBJECT 2.0

body LOCAL_MONEY_TRANSFER /è½¬è´¦.*æ€¥éœ€.*å¸®åŠ©/i
describe LOCAL_MONEY_TRANSFER é‡‘é’±è½¬è´¦è¯ˆéª—æ¨¡å¼
score LOCAL_MONEY_TRANSFER 5.0
```

### 6.3 åŠ¨æ€é˜ˆå€¼ç­–ç•¥


**æ™ºèƒ½é˜ˆå€¼é…ç½®**ï¼š
```perl
# /etc/amavis/conf.d/20-debian_defaults
# ä¸åŒé˜ˆå€¼å¯¹åº”ä¸åŒå¤„ç†
$sa_tag_level_deflt = -999;  # æ€»æ˜¯æ ‡è®°
$sa_tag2_level_deflt = 3.0;  # æ·»åŠ åƒåœ¾é‚®ä»¶æ ‡è®°
$sa_kill_level_deflt = 8.0;  # ç›´æ¥æ‹’ç»
$sa_dsn_cutoff_level = 12;   # ä¸å‘é€é€€ä¿¡é€šçŸ¥
```

**ğŸ“ˆ é˜ˆå€¼ç­–ç•¥å»ºè®®**ï¼š

| åˆ†æ•°èŒƒå›´ | **å¤„ç†æ–¹å¼** | **è¯´æ˜** |
|---------|-------------|----------|
| `< 3åˆ†` | **æ­£å¸¸æŠ•é€’** | `å¯èƒ½æ˜¯æ­£å¸¸é‚®ä»¶` |
| `3-5åˆ†` | **æ ‡è®°æŠ•é€’** | `å¯ç–‘ä½†ä¸ç¡®å®š` |
| `5-8åˆ†` | **åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹** | `å¾ˆå¯èƒ½æ˜¯åƒåœ¾é‚®ä»¶` |
| `> 8åˆ†` | **ç›´æ¥æ‹’ç»** | `ç¡®å®šæ˜¯åƒåœ¾é‚®ä»¶` |

---

## 7. ğŸ“‹ ç™½åå•ä¸é»‘åå•ç®¡ç†


### 7.1 ç™½åå•é…ç½®


**ä»€ä¹ˆæ˜¯ç™½åå•ï¼Ÿ**
```
ç™½åå•å°±åƒVIPé€šè¡Œè¯ï¼š
âœ… åå•å†…çš„å‘ä»¶äººç›´æ¥æ”¾è¡Œ
ğŸš€ è·³è¿‡æ‰€æœ‰è¿‡æ»¤æ£€æŸ¥
ğŸ›¡ï¸ ç¡®ä¿é‡è¦é‚®ä»¶ä¸è¢«è¯¯åˆ¤
```

**Postfixç™½åå•é…ç½®**ï¼š
```bash
# /etc/postfix/main.cf
smtpd_recipient_restrictions = 
    permit_mynetworks,
    check_recipient_access hash:/etc/postfix/whitelist,
    # å…¶ä»–æ£€æŸ¥...

# /etc/postfix/whitelist
important-client@company.com    OK
newsletter@trusted-site.com     OK
billing@bank.com               OK

# ç¼–è¯‘å“ˆå¸Œè¡¨
sudo postmap /etc/postfix/whitelist
```

**SpamAssassinç™½åå•**ï¼š
```bash
# /etc/spamassassin/local.cf
# å‘ä»¶äººç™½åå•
whitelist_from admin@company.com
whitelist_from *@trusted-domain.com

# æ”¶ä»¶äººç™½åå•  
whitelist_to billing@mydomain.com
```

### 7.2 é»‘åå•é…ç½®


**é»‘åå•ç®¡ç†ç­–ç•¥**ï¼š
```bash
# /etc/postfix/blacklist
spam-sender@bad-domain.com     REJECT å‘ä»¶äººè¢«åˆ—å…¥é»‘åå•
*.spam-domain.com              REJECT åƒåœ¾é‚®ä»¶åŸŸå
192.168.100.0/24              REJECT å¯ç–‘IPæ®µ

# /etc/postfix/main.cf
smtpd_client_restrictions = 
    check_client_access hash:/etc/postfix/blacklist,
    permit
```

### 7.3 åŠ¨æ€é»‘åå•é›†æˆ


**RBLå®æ—¶é»‘åå•**ï¼š
```bash
# /etc/postfix/main.cf
smtpd_recipient_restrictions = 
    reject_rbl_client zen.spamhaus.org,
    reject_rbl_client bl.spamcop.net,
    reject_rbl_client dnsbl.sorbs.net,
    permit
```

**ğŸ” å¸¸ç”¨RBLæœåŠ¡**ï¼š
- **Spamhaus ZEN**ï¼šæœ€æƒå¨çš„åƒåœ¾é‚®ä»¶IPåº“
- **SpamCop**ï¼šåŸºäºç”¨æˆ·ä¸¾æŠ¥çš„é»‘åå•
- **SORBS**ï¼šå¼€æ”¾ä»£ç†å’Œåƒåœ¾é‚®ä»¶æºæ£€æµ‹

---

## 8. ğŸ¯ è‡ªåŠ¨å¤„ç†è§„åˆ™é…ç½®


### 8.1 éš”ç¦»è§„åˆ™é…ç½®


**åƒåœ¾é‚®ä»¶éš”ç¦»**ï¼š
```perl
# /etc/amavis/conf.d/20-debian_defaults
# åƒåœ¾é‚®ä»¶éš”ç¦»é…ç½®
$spam_quarantine_to = 'spam-quarantine';
$virus_quarantine_to = 'virus-quarantine';

# éš”ç¦»ç›®å½•
$QUARANTINEDIR = '/var/lib/amavis/virusmails';
```

**éš”ç¦»é‚®ä»¶ç®¡ç†**ï¼š
```bash
# æŸ¥çœ‹éš”ç¦»é‚®ä»¶
sudo amavisd-nanny

# é‡Šæ”¾éš”ç¦»é‚®ä»¶
sudo amavisd-release /var/lib/amavis/virusmails/spam-xxxx

# æ¸…ç†è¿‡æœŸéš”ç¦»é‚®ä»¶
find /var/lib/amavis/virusmails -name "spam-*" -mtime +30 -delete
```

### 8.2 è‡ªåŠ¨åˆ é™¤ç­–ç•¥


**é…ç½®è‡ªåŠ¨åˆ é™¤**ï¼š
```perl
# é«˜åˆ†åƒåœ¾é‚®ä»¶ç›´æ¥åˆ é™¤
$final_spam_destiny = D_DISCARD;

# ç—…æ¯’é‚®ä»¶ç›´æ¥åˆ é™¤
$final_virus_destiny = D_DISCARD;

# è®¾ç½®åˆ é™¤é˜ˆå€¼
$sa_kill_level_deflt = 10.0;  # 10åˆ†ä»¥ä¸Šç›´æ¥åˆ é™¤
```

### 8.3 é€šçŸ¥ä¸æŠ¥å‘Š


**ç®¡ç†å‘˜é€šçŸ¥é…ç½®**ï¼š
```perl
# ç—…æ¯’æ£€æµ‹é€šçŸ¥
$virus_admin = 'admin@yourdomain.com';
$mailfrom_notify_admin = 'postmaster@yourdomain.com';

# åƒåœ¾é‚®ä»¶æŠ¥å‘Š
$spam_admin = 'spam-admin@yourdomain.com';
```

**ğŸ“Š å®šæœŸæŠ¥å‘Šè„šæœ¬**ï¼š
```bash
#!/bin/bash
# /usr/local/bin/mail-report.sh

# ç»Ÿè®¡åƒåœ¾é‚®ä»¶æ•°é‡
SPAM_COUNT=$(grep "Blocked SPAM" /var/log/mail.log | wc -l)

# ç»Ÿè®¡ç—…æ¯’é‚®ä»¶æ•°é‡  
VIRUS_COUNT=$(grep "Blocked INFECTED" /var/log/mail.log | wc -l)

# å‘é€æŠ¥å‘Šé‚®ä»¶
echo "ä»Šæ—¥åƒåœ¾é‚®ä»¶æ‹¦æˆªï¼š$SPAM_COUNT å°
ä»Šæ—¥ç—…æ¯’é‚®ä»¶æ‹¦æˆªï¼š$VIRUS_COUNT å°" | mail -s "é‚®ä»¶è¿‡æ»¤æ—¥æŠ¥" admin@yourdomain.com
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é‚®ä»¶è¿‡æ»¤ï¼šå¤šå±‚æ¬¡æ£€æŸ¥ç¡®ä¿é‚®ä»¶å®‰å…¨
ğŸ”¸ å¤´éƒ¨æ£€æŸ¥ï¼šå¿«é€Ÿæ‹¦æˆªæ˜æ˜¾çš„åƒåœ¾é‚®ä»¶
ğŸ”¸ å†…å®¹è¿‡æ»¤ï¼šæ·±åº¦åˆ†æé‚®ä»¶å†…å®¹å’Œé™„ä»¶
ğŸ”¸ è¯„åˆ†æœºåˆ¶ï¼šé‡åŒ–é£é™©ï¼Œæ™ºèƒ½å†³ç­–
ğŸ”¸ ç™½é»‘åå•ï¼šç²¾ç¡®æ§åˆ¶ç‰¹å®šå‘ä»¶äºº
ğŸ”¸ è‡ªåŠ¨å¤„ç†ï¼šå‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜æ•ˆç‡
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¤šå±‚é˜²æŠ¤çš„å¿…è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦å¤šç§è¿‡æ»¤å·¥å…·ï¼Ÿ
â€¢ å•ä¸€å·¥å…·æ— æ³•åº”å¯¹æ‰€æœ‰å¨èƒ
â€¢ ä¸åŒå·¥å…·æ£€æµ‹é‡ç‚¹ä¸åŒ
â€¢ å¤šå±‚æ£€æŸ¥æé«˜æ£€æµ‹å‡†ç¡®ç‡
â€¢ é™ä½è¯¯åˆ¤æ¦‚ç‡
```

**ğŸ”¹ è¯¯åˆ¤æ§åˆ¶ç­–ç•¥**
```
å¦‚ä½•å‡å°‘è¯¯åˆ¤ï¼Ÿ
â€¢ åˆç†è®¾ç½®è¯„åˆ†é˜ˆå€¼
â€¢ ç»´æŠ¤å‡†ç¡®çš„ç™½åå•
â€¢ å®šæœŸæ£€æŸ¥éš”ç¦»é‚®ä»¶
â€¢ ç”¨æˆ·åé¦ˆæœºåˆ¶
```

**ğŸ”¹ æ€§èƒ½ä¸å®‰å…¨çš„å¹³è¡¡**
```
å¦‚ä½•å¹³è¡¡æ£€æµ‹æ€§èƒ½ï¼Ÿ
â€¢ åˆç†é…ç½®æ£€æŸ¥æ·±åº¦
â€¢ ä¼˜åŒ–è§„åˆ™åŒ¹é…æ•ˆç‡
â€¢ æ§åˆ¶å¹¶å‘æ£€æŸ¥æ•°é‡
â€¢ å®šæœŸæ¸…ç†æ—¥å¿—å’Œéš”ç¦»æ–‡ä»¶
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


- **ä¼ä¸šé‚®ä»¶å®‰å…¨**ï¼šä¿æŠ¤ä¼ä¸šå…å—é‚®ä»¶å¨èƒ
- **ç”¨æˆ·ä½“éªŒæå‡**ï¼šå‡å°‘åƒåœ¾é‚®ä»¶éªšæ‰°
- **æœåŠ¡å™¨èµ„æºä¼˜åŒ–**ï¼šå‡å°‘æ— æ•ˆé‚®ä»¶å¤„ç†
- **åˆè§„è¦æ±‚æ»¡è¶³**ï¼šç¬¦åˆé‚®ä»¶å®‰å…¨è§„èŒƒ

### 9.4 è¿ç»´å®è·µè¦ç‚¹


```
æ—¥å¸¸ç»´æŠ¤æ£€æŸ¥æ¸…å•ï¼š
âœ… æ£€æŸ¥è¿‡æ»¤å™¨è¿è¡ŒçŠ¶æ€
âœ… æ›´æ–°ç—…æ¯’ç‰¹å¾åº“
âœ… åˆ†æåƒåœ¾é‚®ä»¶è¶‹åŠ¿
âœ… è°ƒæ•´è¿‡æ»¤è§„åˆ™é˜ˆå€¼
âœ… æ¸…ç†éš”ç¦»æ–‡ä»¶å­˜å‚¨
âœ… ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨
âœ… å¤‡ä»½é…ç½®æ–‡ä»¶
```

**ğŸ¯ è®°å¿†è¦ç‚¹**ï¼š
- é‚®ä»¶è¿‡æ»¤æ˜¯å¤šå±‚é˜²æŠ¤ï¼Œä¸æ˜¯å•ç‚¹é˜²å¾¡
- è¯„åˆ†æœºåˆ¶è®©å†³ç­–æ›´æ™ºèƒ½ï¼Œä¸æ˜¯ç®€å•çš„é€šè¿‡/æ‹’ç»
- ç™½åå•ä¿è¯é‡è¦é‚®ä»¶ç•…é€šï¼Œé»‘åå•æ‹¦æˆªå·²çŸ¥å¨èƒ
- è‡ªåŠ¨åŒ–å¤„ç†å‡å°‘äººå·¥è´Ÿæ‹…ï¼Œä½†éœ€è¦é€‚å½“ç›‘æ§

**æ ¸å¿ƒç†å¿µ**ï¼š
> é‚®ä»¶è¿‡æ»¤çš„ç›®æ ‡æ˜¯åœ¨ä¿è¯å®‰å…¨çš„å‰æä¸‹ï¼Œæœ€å¤§åŒ–ç”¨æˆ·ä½“éªŒã€‚è¿™éœ€è¦åœ¨æ£€æµ‹å‡†ç¡®æ€§ã€å¤„ç†æ€§èƒ½å’Œè¯¯åˆ¤ç‡ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚