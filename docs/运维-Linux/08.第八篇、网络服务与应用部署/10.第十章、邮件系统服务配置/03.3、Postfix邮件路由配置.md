---
title: 3ã€Postfixé‚®ä»¶è·¯ç”±é…ç½®
---
## ğŸ“š ç›®å½•

1. [Postfixé‚®ä»¶è·¯ç”±åŸºç¡€æ¦‚å¿µ](#1-postfixé‚®ä»¶è·¯ç”±åŸºç¡€æ¦‚å¿µ)
2. [åŸŸåç›¸å…³é…ç½®å‚æ•°](#2-åŸŸåç›¸å…³é…ç½®å‚æ•°)
3. [æœ¬åœ°åŸŸä¸ä¸­ç»§åŸŸé…ç½®](#3-æœ¬åœ°åŸŸä¸ä¸­ç»§åŸŸé…ç½®)
4. [ä¼ è¾“æ˜ å°„ä¸è™šæ‹Ÿåˆ«å](#4-ä¼ è¾“æ˜ å°„ä¸è™šæ‹Ÿåˆ«å)
5. [åœ°å€é‡å†™é…ç½®è¯¦è§£](#5-åœ°å€é‡å†™é…ç½®è¯¦è§£)
6. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#6-å®æˆ˜é…ç½®æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“§ Postfixé‚®ä»¶è·¯ç”±åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é‚®ä»¶è·¯ç”±


**ğŸ’¡ é€šä¿—ç†è§£**
é‚®ä»¶è·¯ç”±å°±åƒå¿«é€’åˆ†æ‹£ä¸­å¿ƒï¼Œå†³å®šæ¯å°é‚®ä»¶åº”è¯¥é€åˆ°å“ªé‡Œå»ã€‚å½“Postfixæ”¶åˆ°ä¸€å°é‚®ä»¶æ—¶ï¼Œå®ƒéœ€è¦åˆ¤æ–­ï¼š
- è¿™å°é‚®ä»¶æ˜¯ç»™æœ¬æœåŠ¡å™¨çš„ç”¨æˆ·å—ï¼Ÿ
- è¿˜æ˜¯éœ€è¦è½¬å‘ç»™å…¶ä»–é‚®ä»¶æœåŠ¡å™¨ï¼Ÿ
- å¦‚æœè½¬å‘ï¼Œåº”è¯¥å‘é€åˆ°å“ªä¸ªæœåŠ¡å™¨ï¼Ÿ

```
é‚®ä»¶è·¯ç”±å†³ç­–æµç¨‹ï¼š
æ”¶åˆ°é‚®ä»¶ â†’ åˆ†ææ”¶ä»¶äººåœ°å€ â†’ æŸ¥çœ‹åŸŸåé…ç½® â†’ å†³å®šå¤„ç†æ–¹å¼

æœ¬åœ°æŠ•é€’ï¼šuser@mydomain.com â†’ æŠ•é€’åˆ°æœ¬åœ°ç”¨æˆ·é‚®ç®±
è½¬å‘æŠ•é€’ï¼šuser@otherdomain.com â†’ è½¬å‘åˆ°å…¶ä»–é‚®ä»¶æœåŠ¡å™¨
æ‹’ç»æŠ•é€’ï¼šuser@spam.com â†’ æ‹’ç»æ¥æ”¶ï¼ˆä¸åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼‰
```

### 1.2 è·¯ç”±é…ç½®çš„é‡è¦æ€§


**ğŸ¯ ä¸ºä»€ä¹ˆè·¯ç”±é…ç½®å¾ˆé‡è¦ï¼Ÿ**
- **å®‰å…¨æ€§**ï¼šé˜²æ­¢æœåŠ¡å™¨è¢«ç”¨ä½œåƒåœ¾é‚®ä»¶ä¸­ç»§
- **æ•ˆç‡æ€§**ï¼šç¡®ä¿é‚®ä»¶èƒ½å¿«é€Ÿåˆ°è¾¾æ­£ç¡®ç›®çš„åœ°
- **å¯é æ€§**ï¼šé¿å…é‚®ä»¶ä¸¢å¤±æˆ–è¯¯æŠ•é€’
- **ç®¡ç†æ€§**ï¼šä¾¿äºé‚®ä»¶ç³»ç»Ÿçš„ç»´æŠ¤å’Œç›‘æ§

### 1.3 æ ¸å¿ƒé…ç½®æ–‡ä»¶


**ğŸ“ ä¸»è¦é…ç½®æ–‡ä»¶ä½ç½®**
```bash
/etc/postfix/main.cf        # ä¸»é…ç½®æ–‡ä»¶
/etc/postfix/transport      # ä¼ è¾“æ˜ å°„æ–‡ä»¶
/etc/postfix/virtual        # è™šæ‹Ÿåˆ«åæ–‡ä»¶
/etc/postfix/canonical      # åœ°å€é‡å†™æ–‡ä»¶
```

---

## 2. ğŸ  åŸŸåç›¸å…³é…ç½®å‚æ•°


### 2.1 mydomainé…ç½®è¯¦è§£


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`mydomain` å‚æ•°å®šä¹‰äº†é‚®ä»¶æœåŠ¡å™¨æ‰€å±çš„é»˜è®¤åŸŸåï¼Œè¿™æ˜¯æ•´ä¸ªé‚®ä»¶ç³»ç»Ÿçš„åŸºç¡€æ ‡è¯†ã€‚

**é…ç½®è¯­æ³•**
```bash
# /etc/postfix/main.cf
mydomain = example.com
```

**ğŸ“‹ å®é™…ä½œç”¨**
- ä½œä¸ºå…¶ä»–å‚æ•°çš„é»˜è®¤å€¼æ¥æº
- ç”¨äºç”Ÿæˆé‚®ä»¶å¤´ä¿¡æ¯
- å½±å“é‚®ä»¶åœ°å€çš„è¡¥å…¨è§„åˆ™

**ğŸ” å…·ä½“ç¤ºä¾‹**
```bash
# è®¾ç½®åŸŸå
mydomain = company.com

# å½“ç”¨æˆ·åªè¾“å…¥ç”¨æˆ·åæ—¶ï¼Œè‡ªåŠ¨è¡¥å…¨ä¸ºï¼š
# zhang â†’ zhang@company.com
# å‘é€é‚®ä»¶æ—¶ï¼ŒFromå­—æ®µå¯èƒ½æ˜¾ç¤ºä¸ºï¼šzhang@company.com
```

### 2.2 myhostnameé…ç½®è¯¦è§£


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`myhostname` å®šä¹‰é‚®ä»¶æœåŠ¡å™¨çš„å®Œæ•´ä¸»æœºåï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æœåŠ¡å™¨æ ‡è¯†ã€‚

**é…ç½®è¯­æ³•**
```bash
myhostname = mail.example.com
```

**ğŸ’¡ ä¸mydomainçš„åŒºåˆ«**
```
mydomain = example.com           # ç»„ç»‡çš„åŸŸå
myhostname = mail.example.com    # é‚®ä»¶æœåŠ¡å™¨çš„å…·ä½“ä¸»æœºå

ç±»æ¯”ç†è§£ï¼š
mydomain åƒå…¬å¸åç§°ï¼šABCå…¬å¸
myhostname åƒå…·ä½“åœ°å€ï¼šABCå…¬å¸åŒ—äº¬åˆ†éƒ¨é‚®ä»¶æœåŠ¡å™¨
```

### 2.3 myoriginé…ç½®è¯¦è§£


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`myorigin` å†³å®šæœ¬åœ°å‘é€é‚®ä»¶æ—¶ä½¿ç”¨çš„é»˜è®¤åŸŸåï¼Œå½±å“é‚®ä»¶çš„å‘ä»¶äººåœ°å€ã€‚

**é…ç½®é€‰é¡¹**
```bash
# é€‰é¡¹1ï¼šä½¿ç”¨ä¸»æœºå
myorigin = $myhostname
# ç»“æœï¼šroot@mail.example.com

# é€‰é¡¹2ï¼šä½¿ç”¨åŸŸåï¼ˆæ¨èï¼‰
myorigin = $mydomain  
# ç»“æœï¼šroot@example.com

# é€‰é¡¹3ï¼šè‡ªå®šä¹‰åŸŸå
myorigin = mail.company.com
```

**ğŸ¯ å®é™…åº”ç”¨åœºæ™¯**
```bash
# ç³»ç»Ÿå‘é€é€šçŸ¥é‚®ä»¶æ—¶çš„å‘ä»¶äººåœ°å€
# å¦‚æœmyorigin = $mydomain
crontabä½œä¸šé€šçŸ¥ â†’ From: root@example.com
ç³»ç»ŸæŠ¥è­¦é‚®ä»¶ â†’ From: admin@example.com

# å¦‚æœmyorigin = $myhostname  
crontabä½œä¸šé€šçŸ¥ â†’ From: root@mail.example.com
ç³»ç»ŸæŠ¥è­¦é‚®ä»¶ â†’ From: admin@mail.example.com
```

### 2.4 ä¸‰è€…å…³ç³»æ€»ç»“


| å‚æ•° | **ä½œç”¨** | **æ¨èè®¾ç½®** | **å½±å“èŒƒå›´** |
|------|---------|-------------|-------------|
| `mydomain` | `ç»„ç»‡åŸŸå` | `company.com` | `ä½œä¸ºå…¶ä»–å‚æ•°çš„åŸºç¡€` |
| `myhostname` | `æœåŠ¡å™¨ä¸»æœºå` | `mail.company.com` | `æœåŠ¡å™¨æ ‡è¯†ï¼ŒSMTPé—®å€™` |
| `myorigin` | `æœ¬åœ°é‚®ä»¶å‘é€åŸŸ` | `$mydomain` | `æœ¬åœ°ç”¨æˆ·å‘ä»¶åœ°å€` |

---

## 3. ğŸ“® æœ¬åœ°åŸŸä¸ä¸­ç»§åŸŸé…ç½®


### 3.1 mydestinationæœ¬åœ°åŸŸé…ç½®


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`mydestination` å‘Šè¯‰Postfixå“ªäº›åŸŸåçš„é‚®ä»¶åº”è¯¥åœ¨æœ¬åœ°æŠ•é€’ï¼Œè€Œä¸æ˜¯è½¬å‘ç»™å…¶ä»–æœåŠ¡å™¨ã€‚

**ğŸ’¡ é€šä¿—ç†è§£**
æŠŠé‚®ä»¶æœåŠ¡å™¨æƒ³è±¡æˆä¸€ä¸ªå°åŒºçš„æ”¶å‘å®¤ï¼š
- `mydestination` å°±æ˜¯è¿™ä¸ªæ”¶å‘å®¤è´Ÿè´£çš„æ¥¼å·æ¸…å•
- æ¸…å•ä¸Šçš„æ¥¼å·ï¼Œé‚®ä»¶ç›´æ¥æŠ•é€’ç»™ä½æˆ·
- ä¸åœ¨æ¸…å•ä¸Šçš„ï¼Œè½¬å‘ç»™å…¶ä»–æ”¶å‘å®¤

**åŸºæœ¬é…ç½®**
```bash
# æ–¹å¼1ï¼šç›´æ¥åˆ—å‡ºåŸŸå
mydestination = example.com, mail.example.com, localhost

# æ–¹å¼2ï¼šä½¿ç”¨å˜é‡ï¼ˆæ¨èï¼‰
mydestination = $mydomain, $myhostname, localhost

# æ–¹å¼3ï¼šåŒ…å«å­åŸŸå
mydestination = example.com, .example.com, localhost
```

**ğŸ“Š é…ç½®æ•ˆæœå¯¹æ¯”**
```
é…ç½®ï¼šmydestination = example.com, localhost

âœ… æœ¬åœ°æŠ•é€’ï¼š
user@example.com â†’ æŠ•é€’åˆ°æœ¬åœ°ç”¨æˆ·user
root@localhost â†’ æŠ•é€’åˆ°æœ¬åœ°ç”¨æˆ·root

âŒ è½¬å‘å¤„ç†ï¼š
user@gmail.com â†’ éœ€è¦è½¬å‘åˆ°gmail.com
admin@company.net â†’ éœ€è¦è½¬å‘åˆ°company.net
```

### 3.2 relay_domainsä¸­ç»§åŸŸè®¾ç½®


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`relay_domains` å®šä¹‰å…è®¸ä¸­ç»§è½¬å‘çš„åŸŸååˆ—è¡¨ï¼Œå³å“ªäº›åŸŸåçš„é‚®ä»¶å¯ä»¥é€šè¿‡æœ¬æœåŠ¡å™¨è½¬å‘ã€‚

**âš ï¸ å®‰å…¨é‡è¦æ€§**
å¦‚æœé…ç½®ä¸å½“ï¼ŒæœåŠ¡å™¨å¯èƒ½æˆä¸º**å¼€æ”¾ä¸­ç»§**ï¼Œè¢«åƒåœ¾é‚®ä»¶å‘é€è€…åˆ©ç”¨ï¼

**å®‰å…¨é…ç½®åŸåˆ™**
```bash
# âœ… å®‰å…¨é…ç½®ï¼šåªä¸­ç»§ç‰¹å®šåŸŸå
relay_domains = partner.com, subsidiary.com

# âœ… æ›´å®‰å…¨ï¼šä¸è®¾ç½®ä¸­ç»§åŸŸï¼ˆé»˜è®¤ï¼‰
relay_domains = 

# âŒ å±é™©é…ç½®ï¼šå¼€æ”¾ä¸­ç»§ï¼ˆç»å¯¹ä¸è¦è¿™æ ·åšï¼ï¼‰
relay_domains = *
```

**ğŸ¯ å®é™…åº”ç”¨åœºæ™¯**
```bash
# ä¼ä¸šåœºæ™¯ï¼šæ€»å…¬å¸ä¸ºåˆ†å…¬å¸ä¸­ç»§é‚®ä»¶
relay_domains = branch1.company.com, branch2.company.com

# æ•ˆæœï¼š
user@branch1.company.com â†’ é€šè¿‡æœ¬æœåŠ¡å™¨è½¬å‘åˆ°branch1
user@branch2.company.com â†’ é€šè¿‡æœ¬æœåŠ¡å™¨è½¬å‘åˆ°branch2
user@outsider.com â†’ æ‹’ç»ä¸­ç»§ï¼ˆé˜²æ­¢åƒåœ¾é‚®ä»¶ï¼‰
```

### 3.3 ä¸­ç»§æƒé™æ§åˆ¶


**ğŸ“‹ é¢å¤–å®‰å…¨æªæ–½**
```bash
# åªå…è®¸ç‰¹å®šç½‘ç»œä¸­ç»§
smtpd_relay_restrictions = 
    permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination

# è®¾ç½®å…è®¸çš„ç½‘ç»œ
mynetworks = 127.0.0.0/8, 192.168.1.0/24
```

---

## 4. ğŸ—ºï¸ ä¼ è¾“æ˜ å°„ä¸è™šæ‹Ÿåˆ«å


### 4.1 transport_mapsä¼ è¾“æ˜ å°„


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`transport_maps` è®©ä½ ç²¾ç¡®æ§åˆ¶é‚®ä»¶çš„ä¼ è¾“æ–¹å¼ï¼Œå¯ä»¥ä¸ºä¸åŒçš„åŸŸåæˆ–åœ°å€æŒ‡å®šä¸åŒçš„ä¼ è¾“æ–¹æ³•ã€‚

**ğŸ’¡ é€šä¿—ç†è§£**
å°±åƒå¿«é€’å…¬å¸çš„åˆ†æ‹£è§„åˆ™ï¼š
- æŸäº›åœ°å€ç”¨é¡ºä¸°å¿«é€’
- æŸäº›åœ°å€ç”¨EMS
- æŸäº›åœ°å€ç”¨è‡ªå·±çš„é…é€è½¦

**é…ç½®æ­¥éª¤**

**æ­¥éª¤1ï¼šå¯ç”¨ä¼ è¾“æ˜ å°„**
```bash
# /etc/postfix/main.cf
transport_maps = hash:/etc/postfix/transport
```

**æ­¥éª¤2ï¼šåˆ›å»ºä¼ è¾“æ˜ å°„æ–‡ä»¶**
```bash
# /etc/postfix/transport
example.com         smtp:[mail.example.com]:25
priority.com        smtp:[priority.example.com]:587
local.company       local:
partner.net         relay:[relay.partner.net]
```

**æ­¥éª¤3ï¼šç¼–è¯‘æ˜ å°„æ–‡ä»¶**
```bash
postmap /etc/postfix/transport
systemctl reload postfix
```

**ğŸ“Š ä¼ è¾“æ–¹å¼è¯´æ˜**

| ä¼ è¾“æ–¹å¼ | **è¯­æ³•** | **ç”¨é€”** | **ç¤ºä¾‹** |
|---------|---------|---------|---------|
| `smtp` | `smtp:[server]:port` | `æ ‡å‡†SMTPä¼ è¾“` | `smtp:[mail.example.com]:25` |
| `local` | `local:` | `æœ¬åœ°æŠ•é€’` | `local:` |
| `relay` | `relay:[server]` | `ä¸­ç»§è½¬å‘` | `relay:[relay.example.com]` |
| `discard` | `discard:` | `ä¸¢å¼ƒé‚®ä»¶` | `discard:` |

### 4.2 virtual_alias_mapsè™šæ‹Ÿåˆ«å


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
è™šæ‹Ÿåˆ«åè®©ä½ åˆ›å»ºé‚®ä»¶åœ°å€çš„"åˆ«å"ï¼Œä¸€ä¸ªè™šæ‹Ÿåœ°å€å¯ä»¥å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªçœŸå®åœ°å€ã€‚

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
- **éƒ¨é—¨é‚®ç®±**ï¼š`sales@company.com` â†’ è½¬å‘ç»™é”€å”®å›¢é˜Ÿæ‰€æœ‰äºº
- **ä¸ªäººåˆ«å**ï¼š`ceo@company.com` â†’ è½¬å‘ç»™ `zhang.san@company.com`
- **åˆ†å‘åˆ—è¡¨**ï¼š`all@company.com` â†’ è½¬å‘ç»™å…¨å…¬å¸å‘˜å·¥

**é…ç½®æ­¥éª¤**

**æ­¥éª¤1ï¼šå¯ç”¨è™šæ‹Ÿåˆ«å**
```bash
# /etc/postfix/main.cf
virtual_alias_maps = hash:/etc/postfix/virtual
```

**æ­¥éª¤2ï¼šåˆ›å»ºåˆ«åæ˜ å°„**
```bash
# /etc/postfix/virtual

# ä¸ªäººåˆ«å
ceo@company.com                zhang.san@company.com
sales@company.com              li.si@company.com
support@company.com            wang.wu@company.com

# åˆ†å‘åˆ—è¡¨
all@company.com                zhang.san@company.com, li.si@company.com, wang.wu@company.com
tech@company.com               dev1@company.com, dev2@company.com

# å¤–éƒ¨è½¬å‘
backup@company.com             backup@gmail.com
```

**æ­¥éª¤3ï¼šç¼–è¯‘å¹¶é‡è½½**
```bash
postmap /etc/postfix/virtual
systemctl reload postfix
```

**ğŸ” åˆ«åå¤„ç†æµç¨‹**
```
æ”¶åˆ°é‚®ä»¶ï¼šTo: sales@company.com
â†“
æŸ¥è¯¢è™šæ‹Ÿåˆ«åè¡¨
â†“
æ‰¾åˆ°æ˜ å°„ï¼šsales@company.com â†’ li.si@company.com  
â†“
é‡å†™æ”¶ä»¶äººåœ°å€
â†“
æŠ•é€’ç»™ï¼šli.si@company.com
```

---

## 5. âœï¸ åœ°å€é‡å†™é…ç½®è¯¦è§£


### 5.1 canonical_mapsåœ°å€é‡å†™


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`canonical_maps` ç”¨äºé‡å†™é‚®ä»¶åœ°å€ï¼Œå¯ä»¥åŒæ—¶å½±å“å‘ä»¶äººå’Œæ”¶ä»¶äººåœ°å€ã€‚

**ğŸ’¡ ä½¿ç”¨åœºæ™¯**
- ç»Ÿä¸€é‚®ä»¶åœ°å€æ ¼å¼
- éšè—å†…éƒ¨é‚®ä»¶åœ°å€
- å®ç°åœ°å€æ ‡å‡†åŒ–

**é…ç½®ç¤ºä¾‹**
```bash
# /etc/postfix/main.cf
canonical_maps = hash:/etc/postfix/canonical

# /etc/postfix/canonical
zhang            zhang.san@company.com
li               li.si@company.com
wang             wang.wu@company.com
@old.company     @company.com
```

### 5.2 sender_canonical_mapså‘ä»¶äººé‡å†™


**ğŸ”¸ ä¸“é—¨ç”¨é€”**
åªé‡å†™å‘ä»¶äººåœ°å€ï¼Œä¸å½±å“æ”¶ä»¶äººåœ°å€ã€‚

**ğŸ’¡ å…¸å‹åº”ç”¨**
- ç»Ÿä¸€å¯¹å¤–å‘ä»¶äººåœ°å€æ ¼å¼
- éšè—å†…éƒ¨ç”¨æˆ·çš„çœŸå®é‚®ç®±

**é…ç½®ç¤ºä¾‹**
```bash
# /etc/postfix/main.cf
sender_canonical_maps = hash:/etc/postfix/sender_canonical

# /etc/postfix/sender_canonical
root@company.com         noreply@company.com
cron@company.com         system@company.com
admin@mail.company.com   admin@company.com
```

**ğŸ” é‡å†™æ•ˆæœ**
```
åŸå§‹é‚®ä»¶ï¼šFrom: root@company.com
é‡å†™åï¼š  From: noreply@company.com

åŸå§‹é‚®ä»¶ï¼šFrom: admin@mail.company.com  
é‡å†™åï¼š  From: admin@company.com
```

### 5.3 recipient_canonical_mapsæ”¶ä»¶äººé‡å†™


**ğŸ”¸ ä¸“é—¨ç”¨é€”**
åªé‡å†™æ”¶ä»¶äººåœ°å€ï¼Œä¸å½±å“å‘ä»¶äººåœ°å€ã€‚

**ğŸ’¡ å…¸å‹åº”ç”¨**
- é‡å®šå‘ç‰¹å®šæ”¶ä»¶äºº
- å®ç°é‚®ä»¶åœ°å€è¿ç§»

**é…ç½®ç¤ºä¾‹**
```bash
# /etc/postfix/main.cf
recipient_canonical_maps = hash:/etc/postfix/recipient_canonical

# /etc/postfix/recipient_canonical
olduser@company.com      newuser@company.com
temp@company.com         /dev/null
legacy@company.com       admin@company.com
```

### 5.4 åœ°å€é‡å†™ä¼˜å…ˆçº§


**ğŸ“Š å¤„ç†é¡ºåº**
```
1. æ¥æ”¶é‚®ä»¶
   â†“
2. recipient_canonical_mapsï¼ˆæ”¶ä»¶äººé‡å†™ï¼‰
   â†“  
3. virtual_alias_mapsï¼ˆè™šæ‹Ÿåˆ«åï¼‰
   â†“
4. canonical_mapsï¼ˆé€šç”¨é‡å†™ï¼‰
   â†“
5. sender_canonical_mapsï¼ˆå‘ä»¶äººé‡å†™ï¼‰
   â†“
6. æœ€ç»ˆæŠ•é€’
```

**âš ï¸ é‡è¦æé†’**
ä¸åŒé‡å†™è§„åˆ™å¯èƒ½ä¼šç›¸äº’å½±å“ï¼Œé…ç½®æ—¶éœ€è¦è€ƒè™‘å¤„ç†é¡ºåºï¼

---

## 6. ğŸ› ï¸ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 6.1 ä¼ä¸šé‚®ä»¶ç³»ç»Ÿé…ç½®


**ğŸ“‹ éœ€æ±‚åœºæ™¯**
- å…¬å¸åŸŸåï¼š`company.com`
- é‚®ä»¶æœåŠ¡å™¨ï¼š`mail.company.com`
- éœ€è¦æ”¯æŒéƒ¨é—¨é‚®ç®±å’Œä¸ªäººé‚®ç®±

**å®Œæ•´é…ç½®æ–‡ä»¶**
```bash
# /etc/postfix/main.cf - åŸºç¡€é…ç½®
mydomain = company.com
myhostname = mail.company.com
myorigin = $mydomain
mydestination = $mydomain, $myhostname, localhost

# è™šæ‹Ÿåˆ«åé…ç½®
virtual_alias_maps = hash:/etc/postfix/virtual

# åœ°å€é‡å†™é…ç½®  
sender_canonical_maps = hash:/etc/postfix/sender_canonical
```

**è™šæ‹Ÿåˆ«åè®¾ç½®**
```bash
# /etc/postfix/virtual
# éƒ¨é—¨é‚®ç®±
sales@company.com          zhang.san@company.com, li.si@company.com
tech@company.com           wang.wu@company.com, zhao.liu@company.com  
hr@company.com             hr.manager@company.com
admin@company.com          admin.user@company.com

# é«˜ç®¡é‚®ç®±
ceo@company.com            ceo.zhang@company.com
cto@company.com            cto.wang@company.com

# å¯¹å¤–ç»Ÿä¸€é‚®ç®±
info@company.com           reception@company.com
support@company.com        support.team@company.com
```

**å‘ä»¶äººé‡å†™è®¾ç½®**
```bash
# /etc/postfix/sender_canonical  
# ç³»ç»Ÿé‚®ä»¶ç»Ÿä¸€å‘ä»¶äºº
root@company.com           system@company.com
postmaster@company.com     admin@company.com
@mail.company.com          @company.com
```

### 6.2 å¤šåŸŸåé‚®ä»¶é…ç½®


**ğŸ“‹ éœ€æ±‚åœºæ™¯**
- ä¸»åŸŸåï¼š`company.com`
- å­åŸŸåï¼š`sales.company.com`, `tech.company.com`
- éœ€è¦ä¸åŒåŸŸåæœ‰ä¸åŒçš„å¤„ç†æ–¹å¼

**ä¼ è¾“æ˜ å°„é…ç½®**
```bash
# /etc/postfix/main.cf
transport_maps = hash:/etc/postfix/transport

# /etc/postfix/transport
company.com             local:
sales.company.com       smtp:[sales-server.company.com]:25
tech.company.com        smtp:[tech-server.company.com]:25
partner.com             relay:[relay.partner.com]
```

### 6.3 é…ç½®éªŒè¯å‘½ä»¤


**ğŸ”§ æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®**
```bash
# æ£€æŸ¥é…ç½®è¯­æ³•
postfix check

# æµ‹è¯•åœ°å€é‡å†™
postmap -q "zhang@company.com" /etc/postfix/virtual

# æµ‹è¯•ä¼ è¾“æ˜ å°„
postmap -q "tech.company.com" /etc/postfix/transport

# æŸ¥çœ‹é…ç½®ç”Ÿæ•ˆæƒ…å†µ
postconf mydomain myhostname myorigin mydestination

# å‘é€æµ‹è¯•é‚®ä»¶
echo "Test message" | mail -s "Test" user@company.com
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å…³é”®é…ç½®å‚æ•°æ€»ç»“


```
ğŸ”¸ åŸŸåé…ç½®ï¼š
  â€¢ mydomain: ç»„ç»‡çš„åŸºç¡€åŸŸå
  â€¢ myhostname: é‚®ä»¶æœåŠ¡å™¨ä¸»æœºå  
  â€¢ myorigin: æœ¬åœ°å‘é€é‚®ä»¶çš„åŸŸå

ğŸ”¸ è·¯ç”±é…ç½®ï¼š
  â€¢ mydestination: æœ¬åœ°æŠ•é€’çš„åŸŸååˆ—è¡¨
  â€¢ relay_domains: å…è®¸ä¸­ç»§çš„åŸŸååˆ—è¡¨

ğŸ”¸ æ˜ å°„é…ç½®ï¼š
  â€¢ transport_maps: ç²¾ç¡®æ§åˆ¶é‚®ä»¶ä¼ è¾“æ–¹å¼
  â€¢ virtual_alias_maps: åˆ›å»ºé‚®ä»¶åˆ«åå’Œåˆ†å‘åˆ—è¡¨

ğŸ”¸ é‡å†™é…ç½®ï¼š
  â€¢ canonical_maps: é€šç”¨åœ°å€é‡å†™
  â€¢ sender_canonical_maps: å‘ä»¶äººåœ°å€é‡å†™
  â€¢ recipient_canonical_maps: æ”¶ä»¶äººåœ°å€é‡å†™
```

### 7.2 é…ç½®æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**
- `myorigin` è®¾ç½®ä¸º `$mydomain` ä¿æŒç»Ÿä¸€
- `relay_domains` ä¸¥æ ¼é™åˆ¶ï¼Œé˜²æ­¢å¼€æ”¾ä¸­ç»§
- ä½¿ç”¨è™šæ‹Ÿåˆ«åå®ç°çµæ´»çš„é‚®ä»¶åˆ†å‘
- é€šè¿‡å‘ä»¶äººé‡å†™ç»Ÿä¸€å¯¹å¤–é‚®ä»¶æ ¼å¼

**âŒ é¿å…é”™è¯¯**
- ä¸è¦è®¾ç½® `relay_domains = *`ï¼ˆå¼€æ”¾ä¸­ç»§ï¼‰
- ä¸è¦åœ¨ `mydestination` ä¸­åŒ…å«å¤ªå¤šåŸŸå
- é‡å†™è§„åˆ™ä¸è¦è¿‡äºå¤æ‚ï¼Œé¿å…å†²çª
- ä¿®æ”¹é…ç½®åè®°å¾—é‡æ–°åŠ è½½æœåŠ¡

### 7.3 æ•…éšœæ’æŸ¥è¦ç‚¹


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**
```bash
# é‚®ä»¶æ— æ³•æŠ•é€’åˆ°æœ¬åœ°ç”¨æˆ·
æ£€æŸ¥ï¼šmydestination æ˜¯å¦åŒ…å«ç›®æ ‡åŸŸå

# é‚®ä»¶è¢«æ‹’ç»ä¸­ç»§  
æ£€æŸ¥ï¼šrelay_domains å’Œ smtpd_relay_restrictions

# åˆ«åä¸ç”Ÿæ•ˆ
æ£€æŸ¥ï¼švirtual_alias_maps æ–‡ä»¶æ˜¯å¦ç¼–è¯‘
æ‰§è¡Œï¼špostmap /etc/postfix/virtual

# åœ°å€é‡å†™ä¸æ­£ç¡®
æ£€æŸ¥ï¼šé‡å†™è§„åˆ™çš„ä¼˜å…ˆçº§å’Œè¯­æ³•
æµ‹è¯•ï¼špostmap -q "address" /etc/postfix/canonical
```

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
- ä½¿ç”¨ `hash:` ç±»å‹æ˜ å°„æé«˜æŸ¥è¯¢é€Ÿåº¦
- å®šæœŸæ¸…ç†æ— ç”¨çš„æ˜ å°„è§„åˆ™
- ç›‘æ§é‚®ä»¶é˜Ÿåˆ—çŠ¶æ€
- åˆç†è®¾ç½®è¶…æ—¶å‚æ•°

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Postfixé‚®ä»¶è·¯ç”±æ ¸å¿ƒæ˜¯åŸŸåé…ç½®å’Œè·¯ç”±å†³ç­–
- å®‰å…¨ç¬¬ä¸€ï¼Œä¸¥æ ¼æ§åˆ¶ä¸­ç»§æƒé™
- è™šæ‹Ÿåˆ«åå’Œåœ°å€é‡å†™æä¾›å¼ºå¤§çš„é‚®ä»¶å¤„ç†çµæ´»æ€§
- é…ç½®ä¿®æ”¹åå¿…é¡»é‡æ–°åŠ è½½æ‰èƒ½ç”Ÿæ•ˆ