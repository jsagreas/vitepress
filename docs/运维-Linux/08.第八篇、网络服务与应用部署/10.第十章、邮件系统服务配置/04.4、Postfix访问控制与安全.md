---
title: 4ã€Postfixè®¿é—®æ§åˆ¶ä¸å®‰å…¨
---
## ğŸ“š ç›®å½•

1. [Postfixè®¿é—®æ§åˆ¶åŸºç¡€æ¦‚å¿µ](#1-postfixè®¿é—®æ§åˆ¶åŸºç¡€æ¦‚å¿µ)
2. [å®¢æˆ·ç«¯é™åˆ¶é…ç½®](#2-å®¢æˆ·ç«¯é™åˆ¶é…ç½®)
3. [å‘ä»¶äººé™åˆ¶é…ç½®](#3-å‘ä»¶äººé™åˆ¶é…ç½®)
4. [æ”¶ä»¶äººé™åˆ¶é…ç½®](#4-æ”¶ä»¶äººé™åˆ¶é…ç½®)
5. [è®¿é—®æ§åˆ¶è¡¨é…ç½®](#5-è®¿é—®æ§åˆ¶è¡¨é…ç½®)
6. [é»‘åå•ä¸ç™½åå•ç®¡ç†](#6-é»‘åå•ä¸ç™½åå•ç®¡ç†)
7. [é€Ÿç‡ä¸è¿æ¥é™åˆ¶](#7-é€Ÿç‡ä¸è¿æ¥é™åˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¡ Postfixè®¿é—®æ§åˆ¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é‚®ä»¶è®¿é—®æ§åˆ¶


**åŸºæœ¬æ¦‚å¿µ**ï¼šé‚®ä»¶è®¿é—®æ§åˆ¶å°±æ˜¯ç»™é‚®ä»¶æœåŠ¡å™¨è®¾ç½®"é—¨å«"ï¼Œå†³å®šå“ªäº›é‚®ä»¶å¯ä»¥é€šè¿‡ï¼Œå“ªäº›è¦è¢«æ‹’ç»

```
é‚®ä»¶ä¼ è¾“è¿‡ç¨‹ï¼š
å‘ä»¶äºº â†’ SMTPå®¢æˆ·ç«¯ â†’ PostfixæœåŠ¡å™¨ â†’ æ”¶ä»¶äºº

è®¿é—®æ§åˆ¶æ£€æŸ¥ç‚¹ï¼š
1. å®¢æˆ·ç«¯è¿æ¥æ£€æŸ¥ï¼ˆè°åœ¨è¿æ¥ï¼Ÿï¼‰
2. å‘ä»¶äººåœ°å€æ£€æŸ¥ï¼ˆè°åœ¨å‘é‚®ä»¶ï¼Ÿï¼‰
3. æ”¶ä»¶äººåœ°å€æ£€æŸ¥ï¼ˆå‘ç»™è°ï¼Ÿï¼‰
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®æ§åˆ¶


**ä¸»è¦ç›®çš„**ï¼š
- ğŸ›¡ï¸ **é˜²æ­¢åƒåœ¾é‚®ä»¶**ï¼šé˜»æ­¢ä¸æ³•åˆ†å­å‘é€åƒåœ¾é‚®ä»¶
- ğŸ”’ **ä¿æŠ¤æœåŠ¡å™¨**ï¼šé¿å…è¢«å½“ä½œåƒåœ¾é‚®ä»¶ä¸­ç»§ç«™
- âš¡ **æ§åˆ¶èµ„æºä½¿ç”¨**ï¼šé˜²æ­¢æœåŠ¡å™¨è¢«æ¶æ„å ç”¨
- ğŸ“§ **æé«˜é‚®ä»¶è´¨é‡**ï¼šç¡®ä¿é‚®ä»¶ç³»ç»Ÿæ­£å¸¸è¿è¡Œ

### 1.3 Postfixé™åˆ¶æœºåˆ¶å·¥ä½œåŸç†


**æ£€æŸ¥é¡ºåº**ï¼šPostfixæŒ‰ç…§ç‰¹å®šé¡ºåºæ£€æŸ¥æ¯å°é‚®ä»¶
```
è¿æ¥å»ºç«‹ â†’ å®¢æˆ·ç«¯æ£€æŸ¥ â†’ å‘ä»¶äººæ£€æŸ¥ â†’ æ”¶ä»¶äººæ£€æŸ¥ â†’ å†…å®¹æ£€æŸ¥
     â†“           â†“           â†“           â†“           â†“
  smtpd_client_ smtpd_sender_ smtpd_recipient_ smtpd_data_
  restrictions  restrictions  restrictions     restrictions
```

**å¤„ç†ç»“æœ**ï¼š
- **ACCEPT** - æ¥å—ï¼Œç»§ç»­ä¸‹ä¸€æ­¥æ£€æŸ¥
- **REJECT** - æ‹’ç»ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯
- **DEFER** - å»¶è¿Ÿå¤„ç†ï¼Œç¨åé‡è¯•
- **DISCARD** - ä¸¢å¼ƒï¼Œä¸é€šçŸ¥å‘ä»¶äºº

---

## 2. ğŸ‘¥ å®¢æˆ·ç«¯é™åˆ¶é…ç½®


### 2.1 smtpd_client_restrictionsè¯¦è§£


**ä½œç”¨**ï¼šæ£€æŸ¥è¿æ¥åˆ°é‚®ä»¶æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ˜¯å¦å¯ä¿¡

```bash
# /etc/postfix/main.cf é…ç½®ç¤ºä¾‹
smtpd_client_restrictions = 
    permit_mynetworks,           # å…è®¸æœ¬åœ°ç½‘ç»œ
    permit_sasl_authenticated,   # å…è®¸è®¤è¯ç”¨æˆ·
    reject_unauth_pipelining,    # æ‹’ç»æœªæˆæƒçš„ç®¡é“æ“ä½œ
    reject_rbl_client zen.spamhaus.org,  # æ£€æŸ¥åƒåœ¾é‚®ä»¶é»‘åå•
    permit                       # é»˜è®¤å…è®¸å…¶ä»–è¿æ¥
```

### 2.2 å¸¸ç”¨å®¢æˆ·ç«¯é™åˆ¶é€‰é¡¹


| é™åˆ¶é€‰é¡¹ | **ä½œç”¨è¯´æ˜** | **ä½¿ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| `permit_mynetworks` | `å…è®¸æœ¬åœ°ç½‘ç»œè¿æ¥` | `å†…ç½‘é‚®ä»¶æœåŠ¡å™¨` |
| `permit_sasl_authenticated` | `å…è®¸å·²è®¤è¯ç”¨æˆ·` | `éœ€è¦è®¤è¯çš„å¤–ç½‘ç”¨æˆ·` |
| `reject_unauth_pipelining` | `æ‹’ç»æœªæˆæƒç®¡é“æ“ä½œ` | `é˜²æ­¢åƒåœ¾é‚®ä»¶å·¥å…·æ”»å‡»` |
| `reject_unknown_client_hostname` | `æ‹’ç»æ— æ³•åå‘è§£æçš„ä¸»æœº` | `æé«˜å®‰å…¨æ€§` |

### 2.3 å®¢æˆ·ç«¯IPæ£€æŸ¥é…ç½®


```bash
# åŸºäºIPåœ°å€çš„è®¿é—®æ§åˆ¶
smtpd_client_restrictions = 
    check_client_access hash:/etc/postfix/client_access,
    permit_mynetworks,
    reject_rbl_client bl.spamcop.net,
    permit

# /etc/postfix/client_access æ–‡ä»¶å†…å®¹
192.168.1.100    OK          # å…è®¸ç‰¹å®šIP
spammer.com      REJECT      # æ‹’ç»ç‰¹å®šåŸŸå
10.0.0.0/8       REJECT      # æ‹’ç»æ•´ä¸ªç½‘æ®µ
```

> ğŸ’¡ **é…ç½®æç¤º**  
> ä¿®æ”¹accessæ–‡ä»¶åï¼Œè®°å¾—è¿è¡Œ `postmap /etc/postfix/client_access` ç”Ÿæˆæ•°æ®åº“æ–‡ä»¶

---

## 3. ğŸ“¤ å‘ä»¶äººé™åˆ¶é…ç½®


### 3.1 smtpd_sender_restrictionsè¯¦è§£


**ä½œç”¨**ï¼šæ£€æŸ¥é‚®ä»¶å‘ä»¶äººåœ°å€æ˜¯å¦åˆæ³•å’Œå¯ä¿¡

```bash
# å‘ä»¶äººé™åˆ¶é…ç½®
smtpd_sender_restrictions = 
    permit_mynetworks,                    # å…è®¸æœ¬åœ°ç½‘ç»œ
    permit_sasl_authenticated,            # å…è®¸è®¤è¯ç”¨æˆ·
    reject_non_fqdn_sender,              # æ‹’ç»éå®Œæ•´åŸŸåçš„å‘ä»¶äºº
    reject_unknown_sender_domain,         # æ‹’ç»æ— æ³•è§£æçš„å‘ä»¶äººåŸŸå
    check_sender_access hash:/etc/postfix/sender_access,
    permit
```

### 3.2 å‘ä»¶äººéªŒè¯æœºåˆ¶


**åŸŸåéªŒè¯**ï¼šç¡®ä¿å‘ä»¶äººåŸŸåçœŸå®å­˜åœ¨
```
æ£€æŸ¥è¿‡ç¨‹ï¼š
user@example.com â†’ æŸ¥è¯¢example.comçš„MXè®°å½• â†’ éªŒè¯åŸŸåæœ‰æ•ˆæ€§
```

**SPFæ£€æŸ¥**ï¼šéªŒè¯å‘ä»¶äººIPæ˜¯å¦è¢«æˆæƒå‘é€è¯¥åŸŸåé‚®ä»¶
```bash
# å¯ç”¨SPFæ£€æŸ¥
smtpd_sender_restrictions = 
    check_policy_service unix:private/policyd-spf,
    permit
```

### 3.3 å‘ä»¶äººé»‘ç™½åå•


```bash
# /etc/postfix/sender_access é…ç½®
# æ ¼å¼ï¼šå‘ä»¶äººåœ°å€/åŸŸå  åŠ¨ä½œ

# å…·ä½“é‚®ç®±æ§åˆ¶
spam@badguy.com          REJECT Spam not allowed
marketing@company.com    OK

# åŸŸåçº§åˆ«æ§åˆ¶  
badcompany.com          REJECT
trusteddomain.com       OK

# é€šé…ç¬¦ä½¿ç”¨
@spammerdomain.com      REJECT
```

**ç”Ÿæ•ˆé…ç½®**ï¼š
```bash
postmap /etc/postfix/sender_access
systemctl reload postfix
```

---

## 4. ğŸ“¥ æ”¶ä»¶äººé™åˆ¶é…ç½®


### 4.1 smtpd_recipient_restrictionsè¯¦è§£


**ä½œç”¨**ï¼šè¿™æ˜¯æœ€é‡è¦çš„é™åˆ¶ï¼Œå†³å®šé‚®ä»¶æ˜¯å¦è¢«æ¥æ”¶

```bash
# æ”¶ä»¶äººé™åˆ¶é…ç½®ï¼ˆæœ€é‡è¦ï¼‰
smtpd_recipient_restrictions = 
    permit_mynetworks,              # å…è®¸æœ¬åœ°ç½‘ç»œ
    permit_sasl_authenticated,      # å…è®¸è®¤è¯ç”¨æˆ·
    reject_unauth_destination,      # æ‹’ç»æœªæˆæƒçš„ç›®çš„åœ°ï¼ˆé˜²ä¸­ç»§ï¼‰
    reject_non_fqdn_recipient,      # æ‹’ç»éå®Œæ•´åŸŸåæ”¶ä»¶äºº
    reject_unknown_recipient_domain, # æ‹’ç»æœªçŸ¥æ”¶ä»¶äººåŸŸå
    permit
```

### 4.2 é˜²æ­¢é‚®ä»¶ä¸­ç»§


**ä»€ä¹ˆæ˜¯é‚®ä»¶ä¸­ç»§**ï¼šæ¶æ„ç”¨æˆ·åˆ©ç”¨ä½ çš„é‚®ä»¶æœåŠ¡å™¨å‘é€åƒåœ¾é‚®ä»¶

```
æ­£å¸¸é‚®ä»¶ï¼šå†…ç½‘ç”¨æˆ· â†’ ä½ çš„æœåŠ¡å™¨ â†’ å¤–ç½‘æ”¶ä»¶äºº âœ…
æ¶æ„ä¸­ç»§ï¼šå¤–ç½‘ç”¨æˆ· â†’ ä½ çš„æœåŠ¡å™¨ â†’ å¤–ç½‘æ”¶ä»¶äºº âŒ

é˜²æ­¢æ–¹æ³•ï¼šreject_unauth_destination
```

### 4.3 æ”¶ä»¶äººéªŒè¯é…ç½®


```bash
# å¯ç”¨æ”¶ä»¶äººéªŒè¯
local_recipient_maps = proxy:unix:passwd.byname $alias_maps
local_recipient_maps = hash:/etc/postfix/virtual

# è™šæ‹ŸåŸŸåæ”¶ä»¶äººéªŒè¯
virtual_mailbox_domains = example.com, test.com
virtual_mailbox_maps = hash:/etc/postfix/virtual_mailbox
```

**æ”¶ä»¶äººæ˜ å°„ç¤ºä¾‹**ï¼š
```bash
# /etc/postfix/virtual_mailbox
admin@example.com       admin/
user1@example.com       user1/
user2@example.com       user2/
```

---

## 5. ğŸ—‚ï¸ è®¿é—®æ§åˆ¶è¡¨é…ç½®


### 5.1 accessæ§åˆ¶è¡¨å·¥ä½œåŸç†


**åŸºæœ¬æ¦‚å¿µ**ï¼šaccessè¡¨å°±åƒä¸€ä¸ª"é€šè®¯å½•"ï¼Œè®°å½•å“ªäº›åœ°å€å¯ä»¥é€šè¿‡ï¼Œå“ªäº›è¦æ‹’ç»

```
æŸ¥è¯¢é¡ºåºï¼ˆä»å…·ä½“åˆ°æŠ½è±¡ï¼‰ï¼š
1. user@example.com      # å®Œæ•´é‚®ç®±åœ°å€
2. @example.com          # åŸŸå
3. example.com           # åŸŸåï¼ˆå¦ä¸€ç§å†™æ³•ï¼‰
4. example              # åŸŸåçš„ä¸€éƒ¨åˆ†
5. 192.168.1.100        # å…·ä½“IPåœ°å€
6. 192.168.1            # IPç½‘æ®µ
```

### 5.2 accessè¡¨é…ç½®æ ¼å¼


```bash
# /etc/postfix/access æ–‡ä»¶æ ¼å¼
# åœ°å€/åŸŸå/IP    åŠ¨ä½œ    [å¯é€‰çš„é”™è¯¯ä¿¡æ¯]

# é‚®ç®±åœ°å€æ§åˆ¶
admin@company.com       OK
spam@badsite.com        REJECT Spam not welcome
user@test.com          DEFER Please try later

# åŸŸåæ§åˆ¶
trustedsupplier.com     OK
spammerdomain.com       REJECT
@marketing.com          DISCARD

# IPåœ°å€æ§åˆ¶
192.168.1.100          OK
10.0.0.0/8             REJECT Private network
202.106.0.0/16         DEFER
```

### 5.3 åŠ¨ä½œç±»å‹è¯¦è§£


| åŠ¨ä½œ | **å«ä¹‰** | **å®¢æˆ·ç«¯çœ‹åˆ°çš„ç»“æœ** |
|------|---------|-------------------|
| `OK` | `ç«‹å³æ¥å—` | `é‚®ä»¶æ­£å¸¸æŠ•é€’` |
| `REJECT` | `æ‹’ç»å¹¶è¿”å›é”™è¯¯` | `5xx æ°¸ä¹…é”™è¯¯` |
| `DEFER` | `æš‚æ—¶æ‹’ç»` | `4xx ä¸´æ—¶é”™è¯¯ï¼Œç¨åé‡è¯•` |
| `DISCARD` | `é™é»˜ä¸¢å¼ƒ` | `250 OKï¼ˆä½†å®é™…ä¸¢å¼ƒï¼‰` |

**ç”Ÿæˆæ•°æ®åº“æ–‡ä»¶**ï¼š
```bash
postmap /etc/postfix/access
# ç”Ÿæˆ access.db æ–‡ä»¶
```

---

## 6. ğŸš« é»‘åå•ä¸ç™½åå•ç®¡ç†


### 6.1 RBLé»‘åå•é…ç½®


**ä»€ä¹ˆæ˜¯RBL**ï¼šReal-time Blackhole Listï¼Œå®æ—¶é»‘æ´åˆ—è¡¨ï¼Œç”±ç¬¬ä¸‰æ–¹ç»´æŠ¤çš„åƒåœ¾é‚®ä»¶æºåˆ—è¡¨

```bash
# å¸¸ç”¨RBLæœåŠ¡é…ç½®
smtpd_client_restrictions = 
    permit_mynetworks,
    permit_sasl_authenticated,
    reject_rbl_client zen.spamhaus.org,     # ç»¼åˆé»‘åå•
    reject_rbl_client bl.spamcop.net,       # SpamCopé»‘åå•  
    reject_rbl_client dnsbl.sorbs.net,      # SORBSé»‘åå•
    permit
```

### 6.2 RBLæœåŠ¡å•†å¯¹æ¯”


| RBLæœåŠ¡å•† | **ç‰¹ç‚¹** | **å‡†ç¡®æ€§** | **æ›´æ–°é¢‘ç‡** |
|-----------|---------|-----------|-------------|
| `Spamhaus` | `æƒå¨æ€§é«˜ï¼Œè¯¯æŠ¥å°‘` | `â­â­â­â­â­` | `å®æ—¶æ›´æ–°` |
| `SpamCop` | `ç”¨æˆ·ä¸¾æŠ¥é©±åŠ¨` | `â­â­â­â­` | `å‡ å°æ—¶å†…` |
| `SORBS` | `è¦†ç›–é¢å¹¿` | `â­â­â­` | `å®šæœŸæ›´æ–°` |

### 6.3 ç™½åå•é…ç½®


**æœ¬åœ°ç½‘ç»œç™½åå•**ï¼š
```bash
# å®šä¹‰å¯ä¿¡ç½‘ç»œ
mynetworks = 127.0.0.0/8, 192.168.1.0/24, 10.0.0.0/8

# æˆ–ä»æ–‡ä»¶è¯»å–
mynetworks = hash:/etc/postfix/mynetworks
```

**è®¤è¯ç”¨æˆ·ç™½åå•**ï¼š
```bash
# å…è®¸é€šè¿‡SASLè®¤è¯çš„ç”¨æˆ·
smtpd_recipient_restrictions = 
    permit_sasl_authenticated,  # è¿™è¡Œè¦æ”¾åœ¨å‰é¢
    å…¶ä»–é™åˆ¶...
```

### 6.4 ä¾‹å¤–è®¾ç½®é…ç½®


```bash
# ä¸ºç‰¹å®šæƒ…å†µè®¾ç½®ä¾‹å¤–
smtpd_client_restrictions = 
    check_client_access hash:/etc/postfix/whitelist,  # å…ˆæ£€æŸ¥ç™½åå•
    reject_rbl_client zen.spamhaus.org,               # å†æ£€æŸ¥é»‘åå•
    permit

# /etc/postfix/whitelist æ–‡ä»¶
partner.company.com    OK    # åˆä½œä¼™ä¼´æ€»æ˜¯å…è®¸
192.168.1.50          OK    # ç‰¹å®šæœåŠ¡å™¨
```

---

## 7. âš¡ é€Ÿç‡ä¸è¿æ¥é™åˆ¶


### 7.1 é€Ÿç‡é™åˆ¶é…ç½®


**ä»€ä¹ˆæ˜¯é€Ÿç‡é™åˆ¶**ï¼šæ§åˆ¶å®¢æˆ·ç«¯å‘é€é‚®ä»¶çš„é¢‘ç‡ï¼Œé˜²æ­¢æ¶æ„æ‰¹é‡å‘é€

```bash
# åŸºæœ¬é€Ÿç‡é™åˆ¶é…ç½®
anvil_rate_time_unit = 60s              # æ—¶é—´å•ä½ï¼ˆ60ç§’ï¼‰
anvil_status_update_time = 600s         # çŠ¶æ€æ›´æ–°é—´éš”

# è¿æ¥é€Ÿç‡é™åˆ¶
smtpd_client_connection_rate_limit = 10  # æ¯åˆ†é’Ÿæœ€å¤š10ä¸ªè¿æ¥
smtpd_client_message_rate_limit = 100    # æ¯åˆ†é’Ÿæœ€å¤š100å°é‚®ä»¶
smtpd_client_recipient_rate_limit = 200  # æ¯åˆ†é’Ÿæœ€å¤š200ä¸ªæ”¶ä»¶äºº
```

### 7.2 è¿æ¥æ•°é™åˆ¶è®¾ç½®


```bash
# å¹¶å‘è¿æ¥é™åˆ¶
smtpd_client_connection_count_limit = 50    # å•IPæœ€å¤š50ä¸ªå¹¶å‘è¿æ¥
smtpd_client_new_tls_session_rate_limit = 20 # TLSä¼šè¯å»ºç«‹é€Ÿç‡é™åˆ¶

# é‚®ä»¶å¤§å°é™åˆ¶
message_size_limit = 20480000               # 20MBé‚®ä»¶å¤§å°é™åˆ¶
mailbox_size_limit = 1024000000            # 1GBé‚®ç®±å¤§å°é™åˆ¶
```

### 7.3 é«˜çº§é™åˆ¶ç­–ç•¥


**åŸºäºæ—¶é—´çš„é™åˆ¶**ï¼š
```bash
# ä½¿ç”¨policyd-weightè¿›è¡Œå¤æ‚æ§åˆ¶
smtpd_recipient_restrictions = 
    check_policy_service inet:127.0.0.1:12525,
    permit

# policyd-weighté…ç½®å¯ä»¥è®¾ç½®ï¼š
# - æ—¶é—´æ®µé™åˆ¶
# - å‘é€é‡é™åˆ¶  
# - å¤æ‚è¯„åˆ†ç³»ç»Ÿ
```

**ç›‘æ§å’Œæ—¥å¿—**ï¼š
```bash
# æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
postfix flush
tail -f /var/log/maillog | grep "anvil"

# å¸¸è§æ—¥å¿—ä¿¡æ¯
# anvil: statistics: max connection rate 5/60s
# anvil: statistics: max message rate 20/60s
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è®¿é—®æ§åˆ¶ä¸‰é“é—¨ï¼šå®¢æˆ·ç«¯æ£€æŸ¥ â†’ å‘ä»¶äººæ£€æŸ¥ â†’ æ”¶ä»¶äººæ£€æŸ¥
ğŸ”¸ é˜²ä¸­ç»§æœ€é‡è¦ï¼šreject_unauth_destinationæ˜¯æ ¸å¿ƒé…ç½®
ğŸ”¸ é»‘ç™½åå•é…åˆï¼šRBL + æœ¬åœ°accessè¡¨ = æœ€ä½³æ•ˆæœ
ğŸ”¸ é€Ÿç‡é™åˆ¶å¿…éœ€ï¼šé˜²æ­¢æœåŠ¡å™¨è¢«æ¶æ„å ç”¨
ğŸ”¸ é…ç½®æœ‰é¡ºåºï¼špermitç±»æŒ‡ä»¤è¦æ”¾åœ¨rejectç±»æŒ‡ä»¤å‰é¢
```

### 8.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ å®‰å…¨é…ç½®çš„åŸºæœ¬åŸåˆ™**
```
å…ˆå…è®¸å¯ä¿¡æ¥æºï¼š
- permit_mynetworksï¼ˆæœ¬åœ°ç½‘ç»œï¼‰
- permit_sasl_authenticatedï¼ˆè®¤è¯ç”¨æˆ·ï¼‰

å†è¿›è¡Œå®‰å…¨æ£€æŸ¥ï¼š
- reject_unauth_destinationï¼ˆé˜²ä¸­ç»§ï¼‰
- reject_rbl_clientï¼ˆé»‘åå•æ£€æŸ¥ï¼‰

æœ€åé»˜è®¤å¤„ç†ï¼š
- permitï¼ˆå…è®¸å…¶ä»–è¿æ¥ï¼‰
```

**ğŸ”¹ é…ç½®ç”Ÿæ•ˆçš„æ­¥éª¤**
```
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
2. ç”Ÿæˆæ•°æ®åº“ï¼špostmap /etc/postfix/access
3. æ£€æŸ¥è¯­æ³•ï¼špostfix check
4. é‡æ–°åŠ è½½ï¼šsystemctl reload postfix
5. æµ‹è¯•éªŒè¯ï¼štelnet localhost 25
```

**ğŸ”¹ è°ƒè¯•å’Œæ’é”™æŠ€å·§**
```
æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼štail -f /var/log/maillog
æµ‹è¯•é…ç½®ï¼špostconf -n | grep restrictions
æ£€æŸ¥è®¿é—®è¡¨ï¼špostmap -q test@example.com hash:/etc/postfix/access
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**æ–°æ‰‹é…ç½®å»ºè®®**ï¼š
```bash
# æœ€åŸºæœ¬çš„å®‰å…¨é…ç½®
smtpd_client_restrictions = permit_mynetworks, permit_sasl_authenticated, permit
smtpd_sender_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_non_fqdn_sender, permit  
smtpd_recipient_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination, permit
```

**è¿›é˜¶å®‰å…¨é…ç½®**ï¼š
```bash
# æ›´ä¸¥æ ¼çš„å®‰å…¨ç­–ç•¥
smtpd_recipient_restrictions = 
    permit_mynetworks,
    permit_sasl_authenticated,  
    reject_unauth_destination,
    reject_non_fqdn_recipient,
    reject_unknown_recipient_domain,
    reject_rbl_client zen.spamhaus.org,
    permit
```

**å¸¸è§é”™è¯¯é¿å…**ï¼š
- âŒ ä¸è¦æŠŠ `reject_unauth_destination` æ”¾åœ¨ `permit` åé¢
- âŒ ä¸è¦å¿˜è®°è¿è¡Œ `postmap` å‘½ä»¤æ›´æ–°æ•°æ®åº“
- âŒ ä¸è¦è®¾ç½®è¿‡äºä¸¥æ ¼çš„RBLæ£€æŸ¥å¯¼è‡´è¯¯æ‹’
- âŒ ä¸è¦å¿˜è®°ä¸ºåˆä½œä¼™ä¼´è®¾ç½®ç™½åå•ä¾‹å¤–

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- è®¿é—®æ§åˆ¶å°±åƒç»™é‚®ä»¶æœåŠ¡å™¨å®‰è£…"é—¨å«ç³»ç»Ÿ"
- ä¸‰é“æ£€æŸ¥ï¼šå®¢æˆ·ç«¯ã€å‘ä»¶äººã€æ”¶ä»¶äººï¼Œå±‚å±‚æŠŠå…³
- é˜²ä¸­ç»§æ˜¯æ ¸å¿ƒï¼Œreject_unauth_destination æœ€é‡è¦
- é»‘åå• + ç™½åå• + é€Ÿç‡é™åˆ¶ = å®Œæ•´çš„å®‰å…¨ä½“ç³»
- é…ç½®åä¸€å®šè¦æµ‹è¯•ï¼Œç¡®ä¿æ—¢å®‰å…¨åˆä¸å½±å“æ­£å¸¸ä½¿ç”¨