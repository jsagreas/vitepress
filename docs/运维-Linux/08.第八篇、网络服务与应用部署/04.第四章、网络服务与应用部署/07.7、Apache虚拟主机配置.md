---
title: 7ã€Apacheè™šæ‹Ÿä¸»æœºé…ç½®
---
## ğŸ“š ç›®å½•

1. [è™šæ‹Ÿä¸»æœºåŸºç¡€æ¦‚å¿µ](#1-è™šæ‹Ÿä¸»æœºåŸºç¡€æ¦‚å¿µ)
2. [VirtualHosté…ç½®è¯¦è§£](#2-virtualhosté…ç½®è¯¦è§£)
3. [ä¸‰ç§è™šæ‹Ÿä¸»æœºç±»å‹](#3-ä¸‰ç§è™šæ‹Ÿä¸»æœºç±»å‹)
4. [ç›®å½•æƒé™ä¸å®‰å…¨é…ç½®](#4-ç›®å½•æƒé™ä¸å®‰å…¨é…ç½®)
5. [å¤šç«™ç‚¹ç®¡ç†æœ€ä½³å®è·µ](#5-å¤šç«™ç‚¹ç®¡ç†æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ è™šæ‹Ÿä¸»æœºåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è™šæ‹Ÿä¸»æœº


**ç®€å•ç†è§£**ï¼šè™šæ‹Ÿä¸»æœºå°±åƒä¸€æ ‹å¤§æ¥¼é‡Œçš„ä¸åŒæˆ¿é—´ï¼Œæ¯ä¸ªæˆ¿é—´éƒ½æœ‰è‡ªå·±çš„é—¨ç‰Œå·ï¼ˆåŸŸåï¼‰ï¼Œä½†å…±ç”¨åŒä¸€ä¸ªåœ°å€ï¼ˆæœåŠ¡å™¨IPï¼‰ã€‚

```
ç‰©ç†æœåŠ¡å™¨å¯¹æ¯”ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šä¸€å°æœåŠ¡å™¨ = ä¸€ä¸ªç½‘ç«™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡å™¨A        â”‚ â†’ www.site1.com
â”‚  IP: 192.168.1.10 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è™šæ‹Ÿä¸»æœºæ–¹å¼ï¼šä¸€å°æœåŠ¡å™¨ = å¤šä¸ªç½‘ç«™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApacheæœåŠ¡å™¨   â”‚ â†’ www.site1.com
â”‚  IP: 192.168.1.10 â”‚ â†’ www.site2.com  
â”‚                 â”‚ â†’ blog.example.com
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> è™šæ‹Ÿä¸»æœºå…è®¸ä¸€å°ApacheæœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªç‹¬ç«‹çš„ç½‘ç«™ï¼Œæ¯ä¸ªç½‘ç«™æœ‰è‡ªå·±çš„åŸŸåã€æ–‡æ¡£æ ¹ç›®å½•å’Œé…ç½®ï¼Œä½†å…±äº«åŒä¸€ä¸ªæœåŠ¡å™¨èµ„æºã€‚

### 1.2 è™šæ‹Ÿä¸»æœºçš„ä¼˜åŠ¿


**ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿä¸»æœºï¼Ÿ**

ğŸŒ± **æˆæœ¬æ•ˆç›Š**ï¼š
- ä¸€å°æœåŠ¡å™¨è¿è¡Œå¤šä¸ªç½‘ç«™
- å‡å°‘ç¡¬ä»¶å’Œç»´æŠ¤æˆæœ¬
- æé«˜æœåŠ¡å™¨èµ„æºåˆ©ç”¨ç‡

ğŸŒ¿ **ç®¡ç†ä¾¿åˆ©**ï¼š
- é›†ä¸­ç®¡ç†å¤šä¸ªç«™ç‚¹
- ç»Ÿä¸€çš„æœåŠ¡å™¨é…ç½®
- ç®€åŒ–è¿ç»´å·¥ä½œ

ğŸŒ³ **çµæ´»æ‰©å±•**ï¼š
- å¯ä»¥éšæ—¶æ·»åŠ æ–°ç«™ç‚¹
- ç‹¬ç«‹çš„ç«™ç‚¹é…ç½®
- ä¸å½±å“å…¶ä»–ç«™ç‚¹è¿è¡Œ

### 1.3 è™šæ‹Ÿä¸»æœºå·¥ä½œåŸç†


**Apacheå¦‚ä½•çŸ¥é“ç”¨æˆ·è¦è®¿é—®å“ªä¸ªç½‘ç«™ï¼Ÿ**

```
ç”¨æˆ·è®¿é—®æµç¨‹ï¼š
1. ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥ï¼šwww.site1.com
2. DNSè§£æè¿”å›æœåŠ¡å™¨IPï¼š192.168.1.10
3. æµè§ˆå™¨å‘é€HTTPè¯·æ±‚åˆ°æœåŠ¡å™¨
4. è¯·æ±‚å¤´åŒ…å«ï¼šHost: www.site1.com
5. Apacheè¯»å–Hostå¤´ï¼ŒåŒ¹é…å¯¹åº”çš„è™šæ‹Ÿä¸»æœºé…ç½®
6. è¿”å›å¯¹åº”ç½‘ç«™çš„å†…å®¹
```

**å…³é”®è¯†åˆ«ä¿¡æ¯**ï¼š
- **Hostå¤´**ï¼šæµè§ˆå™¨å‘Šè¯‰æœåŠ¡å™¨è¦è®¿é—®çš„åŸŸå
- **IPåœ°å€**ï¼šæœåŠ¡å™¨ç»‘å®šçš„ç½‘ç»œæ¥å£
- **ç«¯å£å·**ï¼šæœåŠ¡ç›‘å¬çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯80æˆ–443ï¼‰

---

## 2. âš™ï¸ VirtualHosté…ç½®è¯¦è§£


### 2.1 åŸºæœ¬é…ç½®ç»“æ„


**VirtualHostçš„åŸºæœ¬è¯­æ³•**ï¼š

```apache
<VirtualHost IPåœ°å€:ç«¯å£>
    # ç«™ç‚¹åŸºæœ¬ä¿¡æ¯
    ServerName ä¸»åŸŸå
    ServerAlias åˆ«ååŸŸå
    DocumentRoot ç½‘ç«™æ–‡ä»¶è·¯å¾„
    
    # è®¿é—®æ—¥å¿—
    ErrorLog é”™è¯¯æ—¥å¿—è·¯å¾„
    CustomLog è®¿é—®æ—¥å¿—è·¯å¾„ æ ¼å¼
    
    # å…¶ä»–é…ç½®...
</VirtualHost>
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> VirtualHostå°±åƒç»™æ¯ä¸ªç½‘ç«™åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„"æˆ¿é—´"ï¼Œ`ServerName`æ˜¯æˆ¿é—´çš„ä¸»è¦é—¨ç‰Œå·ï¼Œ`DocumentRoot`æ˜¯æˆ¿é—´é‡Œå­˜æ”¾ä¸œè¥¿çš„åœ°æ–¹ã€‚

### 2.2 æ ¸å¿ƒé…ç½®æŒ‡ä»¤è¯¦è§£


#### ğŸ  DocumentRoot - ç½‘ç«™æ–‡ä»¶å­˜æ”¾ä½ç½®


**ä½œç”¨**ï¼šå‘Šè¯‰Apacheè¿™ä¸ªç½‘ç«™çš„æ–‡ä»¶æ”¾åœ¨å“ªé‡Œ

```apache
# ç¤ºä¾‹ï¼šè®¾ç½®ç½‘ç«™æ ¹ç›®å½•
DocumentRoot "/var/www/site1"

# å½“ç”¨æˆ·è®¿é—® www.site1.com/about.html æ—¶
# Apacheä¼šå¯»æ‰¾æ–‡ä»¶ï¼š/var/www/site1/about.html
```

**æœ€ä½³å®è·µ**ï¼š
- æ¯ä¸ªç«™ç‚¹ä½¿ç”¨ç‹¬ç«‹çš„ç›®å½•
- ç›®å½•åç§°è¦æœ‰æ„ä¹‰ä¸”æ˜“è¯†åˆ«
- é¿å…ä½¿ç”¨ç³»ç»Ÿæ•æ„Ÿç›®å½•

#### ğŸ·ï¸ ServerName - ä¸»åŸŸåè®¾ç½®


**ä½œç”¨**ï¼šå®šä¹‰è¿™ä¸ªè™šæ‹Ÿä¸»æœºçš„ä¸»è¦åŸŸå

```apache
# ä¸»åŸŸåè®¾ç½®
ServerName www.example.com

# ç”¨æˆ·è®¿é—®æ—¶çš„Hostå¤´åŒ¹é…ï¼š
# Host: www.example.com âœ… åŒ¹é…æˆåŠŸ
# Host: example.com    âŒ ä¸åŒ¹é…ï¼ˆéœ€è¦ServerAliasï¼‰
```

#### ğŸ”„ ServerAlias - åŸŸååˆ«å


**ä½œç”¨**ï¼šä¸ºè™šæ‹Ÿä¸»æœºæ·»åŠ é¢å¤–çš„åŸŸå

```apache
ServerName www.example.com
ServerAlias example.com blog.example.com *.example.com

# ç°åœ¨è¿™äº›åŸŸåéƒ½ä¼šè®¿é—®åŒä¸€ä¸ªç½‘ç«™ï¼š
# www.example.com     âœ…
# example.com         âœ…  
# blog.example.com    âœ…
# any.example.com     âœ… ï¼ˆé€šé…ç¬¦åŒ¹é…ï¼‰
```

### 2.3 å®Œæ•´é…ç½®ç¤ºä¾‹


**å®é™…ç½‘ç«™é…ç½®æ¡ˆä¾‹**ï¼š

```apache
<VirtualHost *:80>
    # === åŸºæœ¬ç«™ç‚¹ä¿¡æ¯ ===
    ServerName www.mycompany.com
    ServerAlias mycompany.com company.local
    DocumentRoot "/var/www/mycompany"
    
    # === æ—¥å¿—é…ç½® ===
    ErrorLog "/var/log/apache2/mycompany_error.log"
    CustomLog "/var/log/apache2/mycompany_access.log" combined
    
    # === ç›®å½•æƒé™ ===
    <Directory "/var/www/mycompany">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # === PHPæ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰===
    <FilesMatch "\.php$">
        SetHandler application/x-httpd-php
    </FilesMatch>
</VirtualHost>
```

---

## 3. ğŸ”€ ä¸‰ç§è™šæ‹Ÿä¸»æœºç±»å‹


### 3.1 åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœºï¼ˆæ¨èï¼‰


**åŸç†**ï¼šé€šè¿‡HTTPè¯·æ±‚ä¸­çš„Hostå¤´åŒºåˆ†ä¸åŒç½‘ç«™

**é…ç½®ç¤ºä¾‹**ï¼š

```apache
# ç¬¬ä¸€ä¸ªç½‘ç«™
<VirtualHost *:80>
    ServerName www.site1.com
    DocumentRoot "/var/www/site1"
    ErrorLog "logs/site1_error.log"
    CustomLog "logs/site1_access.log" common
</VirtualHost>

# ç¬¬äºŒä¸ªç½‘ç«™
<VirtualHost *:80>
    ServerName www.site2.com  
    DocumentRoot "/var/www/site2"
    ErrorLog "logs/site2_error.log"
    CustomLog "logs/site2_access.log" common
</VirtualHost>
```

**è®¿é—®æµç¨‹å›¾ç¤º**ï¼š
```
ç”¨æˆ·è¯·æ±‚                Apacheå¤„ç†                 ç»“æœ
  |                       |                        |
è®¿é—®site1.com  â†’  æ£€æŸ¥Host: site1.com  â†’  è¿”å›/var/www/site1
è®¿é—®site2.com  â†’  æ£€æŸ¥Host: site2.com  â†’  è¿”å›/var/www/site2
```

> âš ï¸ **é‡è¦æé†’**  
> æ‰€æœ‰åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœºå¿…é¡»ä½¿ç”¨ç›¸åŒçš„IPåœ°å€å’Œç«¯å£ç»„åˆï¼Œé€šå¸¸æ˜¯ `*:80`

### 3.2 åŸºäºIPçš„è™šæ‹Ÿä¸»æœº


**åŸç†**ï¼šæœåŠ¡å™¨ç»‘å®šå¤šä¸ªIPåœ°å€ï¼Œæ¯ä¸ªIPå¯¹åº”ä¸€ä¸ªç½‘ç«™

**é…ç½®ç¤ºä¾‹**ï¼š

```apache
# éœ€è¦å…ˆç»‘å®šå¤šä¸ªIPåˆ°æœåŠ¡å™¨
# 192.168.1.10 ç”¨äºç½‘ç«™1
<VirtualHost 192.168.1.10:80>
    DocumentRoot "/var/www/site1"
    # ä¸éœ€è¦ServerNameï¼Œå› ä¸ºé€šè¿‡IPåŒºåˆ†
</VirtualHost>

# 192.168.1.11 ç”¨äºç½‘ç«™2  
<VirtualHost 192.168.1.11:80>
    DocumentRoot "/var/www/site2"
</VirtualHost>
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- SSLè¯ä¹¦è¦æ±‚ï¼ˆæ—§ç‰ˆæœ¬ï¼‰
- ç‰¹æ®Šå®‰å…¨éœ€æ±‚
- ç½‘ç»œéš”ç¦»è¦æ±‚

### 3.3 åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº


**åŸç†**ï¼šåŒä¸€IPåœ°å€ä½¿ç”¨ä¸åŒç«¯å£åŒºåˆ†ç½‘ç«™

**é…ç½®ç¤ºä¾‹**ï¼š

```apache
# é¦–å…ˆç›‘å¬å¤šä¸ªç«¯å£
Listen 80
Listen 8080
Listen 8090

# ç«¯å£80çš„ç½‘ç«™
<VirtualHost *:80>
    DocumentRoot "/var/www/main"
    ServerName www.example.com
</VirtualHost>

# ç«¯å£8080çš„ç½‘ç«™
<VirtualHost *:8080>
    DocumentRoot "/var/www/admin"  
    ServerName admin.example.com
</VirtualHost>

# ç«¯å£8090çš„ç½‘ç«™
<VirtualHost *:8090>
    DocumentRoot "/var/www/api"
    ServerName api.example.com
</VirtualHost>
```

**è®¿é—®æ–¹å¼**ï¼š
- `http://www.example.com` ï¼ˆé»˜è®¤80ç«¯å£ï¼‰
- `http://admin.example.com:8080`
- `http://api.example.com:8090`

| ğŸ†š è™šæ‹Ÿä¸»æœºç±»å‹å¯¹æ¯” | **åŸºäºåŸŸå** | **åŸºäºIP** | **åŸºäºç«¯å£** |
|-------------------|-------------|-----------|-------------|
| **å®ç°éš¾åº¦** | ğŸŒ± ç®€å• | ğŸŒ³ å¤æ‚ | ğŸŒ¿ ä¸­ç­‰ |
| **èµ„æºéœ€æ±‚** | ğŸ’µ ä½ | ğŸ’° é«˜ | ğŸ’µ ä½ |
| **ç”¨æˆ·ä½“éªŒ** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ |
| **æ¨èç¨‹åº¦** | âœ… æ¨è | ğŸ”¶ ç‰¹æ®Šåœºæ™¯ | ğŸ”¶ å†…éƒ¨ä½¿ç”¨ |

---

## 4. ğŸ”’ ç›®å½•æƒé™ä¸å®‰å…¨é…ç½®


### 4.1 DirectoryæŒ‡ä»¤è¯¦è§£


**Directoryçš„ä½œç”¨**ï¼šæ§åˆ¶ç‰¹å®šç›®å½•çš„è®¿é—®æƒé™å’Œè¡Œä¸º

```apache
<Directory "/var/www/mysite">
    # ç›®å½•é€‰é¡¹
    Options Indexes FollowSymLinks
    
    # .htaccessæ–‡ä»¶æƒé™
    AllowOverride All
    
    # è®¿é—®æ§åˆ¶
    Require all granted
</Directory>
```

### 4.2 OptionsæŒ‡ä»¤è¯¦è§£


**Optionsæ§åˆ¶ç›®å½•çš„åŠŸèƒ½ç‰¹æ€§**ï¼š

```apache
# å¸¸ç”¨é€‰é¡¹ç»„åˆ
Options Indexes FollowSymLinks

# å„é€‰é¡¹å«ä¹‰ï¼š
# Indexes       - å…è®¸ç›®å½•æµè§ˆï¼ˆæ²¡æœ‰indexæ–‡ä»¶æ—¶æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ï¼‰
# FollowSymLinks - å…è®¸è·Ÿéšç¬¦å·é“¾æ¥
# ExecCGI       - å…è®¸æ‰§è¡ŒCGIè„šæœ¬
# Includes      - å…è®¸æœåŠ¡å™¨ç«¯åŒ…å«ï¼ˆSSIï¼‰
# None          - ç¦ç”¨æ‰€æœ‰é€‰é¡¹
# All           - å¯ç”¨æ‰€æœ‰é€‰é¡¹ï¼ˆé™¤MultiViewsï¼‰
```

**å®‰å…¨é…ç½®å»ºè®®**ï¼š

```apache
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
<Directory "/var/www/mysite">
    # ç¦ç”¨ç›®å½•æµè§ˆï¼Œæé«˜å®‰å…¨æ€§
    Options -Indexes +FollowSymLinks
    
    # é™åˆ¶.htaccessæƒé™
    AllowOverride FileInfo AuthConfig Limit
    
    # åªå…è®¸æˆæƒè®¿é—®
    Require all granted
</Directory>

# ç‰¹åˆ«ä¿æŠ¤æ•æ„Ÿç›®å½•
<Directory "/var/www/mysite/admin">
    Options None
    AllowOverride None
    Require ip 192.168.1.0/24  # åªå…è®¸å†…ç½‘è®¿é—®
</Directory>
```

### 4.3 .htaccessæ–‡ä»¶ä½¿ç”¨


**.htaccessæ˜¯ä»€ä¹ˆ**ï¼š
- åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶ï¼Œæ”¾åœ¨ç½‘ç«™ç›®å½•ä¸­
- å¯ä»¥è¦†ç›–è™šæ‹Ÿä¸»æœºçš„éƒ¨åˆ†é…ç½®
- æ— éœ€é‡å¯Apacheå³å¯ç”Ÿæ•ˆ

**å¸¸ç”¨.htaccessé…ç½®**ï¼š

```apache
# .htaccessæ–‡ä»¶ç¤ºä¾‹

# URLé‡å†™ï¼ˆSEOå‹å¥½ï¼‰
RewriteEngine On
RewriteRule ^product/([0-9]+)$ product.php?id=$1 [L]

# å¼ºåˆ¶HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
<Files ".env">
    Require all denied
</Files>

# è®¾ç½®ç¼“å­˜å¤´
<FilesMatch "\.(css|js|png|jpg|jpeg|gif)$">
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
</FilesMatch>
```

> âš ï¸ **æ€§èƒ½æé†’**  
> .htaccessæ–‡ä»¶ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºApacheéœ€è¦åœ¨æ¯æ¬¡è¯·æ±‚æ—¶æ£€æŸ¥ç›®å½•æ ‘ä¸­çš„.htaccessæ–‡ä»¶ã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®å°†é…ç½®å†™å…¥è™šæ‹Ÿä¸»æœºé…ç½®ä¸­ã€‚

### 4.4 AllowOverrideæŒ‡ä»¤


**æ§åˆ¶.htaccessæ–‡ä»¶å¯ä»¥è¦†ç›–å“ªäº›é…ç½®**ï¼š

```apache
# å®Œå…¨ç¦ç”¨.htaccessï¼ˆæœ€ä½³æ€§èƒ½ï¼‰
AllowOverride None

# å…è®¸æ‰€æœ‰è¦†ç›–ï¼ˆæœ€å¤§çµæ´»æ€§ï¼‰
AllowOverride All

# ç²¾ç¡®æ§åˆ¶ï¼ˆæ¨èï¼‰
AllowOverride FileInfo AuthConfig Limit

# å„é€‰é¡¹å«ä¹‰ï¼š
# None      - ç¦ç”¨.htaccess
# All       - å…è®¸æ‰€æœ‰æŒ‡ä»¤
# FileInfo  - å…è®¸æ–‡ä»¶ç±»å‹æ§åˆ¶æŒ‡ä»¤
# AuthConfig - å…è®¸è®¤è¯æˆæƒæŒ‡ä»¤  
# Limit     - å…è®¸è®¿é—®æ§åˆ¶æŒ‡ä»¤
# Options   - å…è®¸OptionsæŒ‡ä»¤
```

---

## 5. ğŸ—ï¸ å¤šç«™ç‚¹ç®¡ç†æœ€ä½³å®è·µ


### 5.1 sites-available/sites-enabledç®¡ç†


**Debian/Ubuntuç³»ç»Ÿçš„ç«™ç‚¹ç®¡ç†æ–¹å¼**ï¼š

```
ç›®å½•ç»“æ„ï¼š
/etc/apache2/
â”œâ”€â”€ sites-available/     # æ‰€æœ‰ç«™ç‚¹é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ 000-default.conf
â”‚   â”œâ”€â”€ site1.conf
â”‚   â””â”€â”€ site2.conf
â””â”€â”€ sites-enabled/       # å¯ç”¨çš„ç«™ç‚¹ï¼ˆç¬¦å·é“¾æ¥ï¼‰
    â”œâ”€â”€ 000-default.conf -> ../sites-available/000-default.conf
    â””â”€â”€ site1.conf -> ../sites-available/site1.conf
```

**ç®¡ç†å‘½ä»¤**ï¼š

```bash
# åˆ›å»ºæ–°ç«™ç‚¹é…ç½®
sudo nano /etc/apache2/sites-available/mysite.conf

# å¯ç”¨ç«™ç‚¹
sudo a2ensite mysite.conf

# ç¦ç”¨ç«™ç‚¹  
sudo a2dissite mysite.conf

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload apache2
```

### 5.2 æ ‡å‡†ç«™ç‚¹é…ç½®æ¨¡æ¿


**ç”Ÿäº§ç¯å¢ƒæ¨èçš„é…ç½®æ¨¡æ¿**ï¼š

```apache
# /etc/apache2/sites-available/mysite.conf

<VirtualHost *:80>
    # === åŸºæœ¬ä¿¡æ¯ ===
    ServerName www.mysite.com
    ServerAlias mysite.com
    ServerAdmin admin@mysite.com
    DocumentRoot /var/www/mysite/public
    
    # === æ—¥å¿—é…ç½® ===
    LogLevel warn
    ErrorLog ${APACHE_LOG_DIR}/mysite_error.log
    CustomLog ${APACHE_LOG_DIR}/mysite_access.log combined
    
    # === ç›®å½•é…ç½® ===
    <Directory /var/www/mysite/public>
        Options -Indexes +FollowSymLinks
        AllowOverride FileInfo AuthConfig Limit
        Require all granted
        
        # PHPé…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
        <FilesMatch "\.php$">
            SetHandler application/x-httpd-php
        </FilesMatch>
    </Directory>
    
    # === é™æ€èµ„æºä¼˜åŒ– ===
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
        Header append Cache-Control "public"
    </LocationMatch>
    
    # === å®‰å…¨é…ç½® ===
    # éšè—Apacheç‰ˆæœ¬ä¿¡æ¯
    ServerTokens Prod
    
    # ç¦æ­¢è®¿é—®.htaccessç­‰æ•æ„Ÿæ–‡ä»¶
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
</VirtualHost>
```

### 5.3 å¤šç«™ç‚¹ç›®å½•ç»“æ„è§„åˆ’


**æ¨èçš„ç›®å½•ç»„ç»‡æ–¹å¼**ï¼š

```
/var/www/
â”œâ”€â”€ site1.com/
â”‚   â”œâ”€â”€ public/          # ç½‘ç«™æ ¹ç›®å½•ï¼ˆDocumentRootæŒ‡å‘è¿™é‡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ js/
â”‚   â”œâ”€â”€ logs/           # ç«™ç‚¹ä¸“ç”¨æ—¥å¿—
â”‚   â””â”€â”€ config/         # ç«™ç‚¹é…ç½®æ–‡ä»¶
â”œâ”€â”€ site2.com/
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ logs/
â”‚   â””â”€â”€ config/
â””â”€â”€ shared/             # å…±äº«èµ„æº
    â”œâ”€â”€ ssl/           # SSLè¯ä¹¦
    â””â”€â”€ scripts/       # é€šç”¨è„šæœ¬
```

### 5.4 SSL/HTTPSé…ç½®


**ä¸ºè™šæ‹Ÿä¸»æœºé…ç½®HTTPS**ï¼š

```apache
# HTTPè™šæ‹Ÿä¸»æœºï¼ˆé‡å®šå‘åˆ°HTTPSï¼‰
<VirtualHost *:80>
    ServerName www.mysite.com
    ServerAlias mysite.com
    
    # é‡å®šå‘æ‰€æœ‰HTTPè¯·æ±‚åˆ°HTTPS
    Redirect permanent / https://www.mysite.com/
</VirtualHost>

# HTTPSè™šæ‹Ÿä¸»æœº
<VirtualHost *:443>
    ServerName www.mysite.com
    ServerAlias mysite.com
    DocumentRoot /var/www/mysite/public
    
    # SSLé…ç½®
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/mysite.crt
    SSLCertificateKeyFile /etc/ssl/private/mysite.key
    SSLCertificateChainFile /etc/ssl/certs/mysite-chain.crt
    
    # å®‰å…¨SSLé…ç½®
    SSLProtocol all -SSLv2 -SSLv3
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
    SSLHonorCipherOrder on
    
    # å…¶ä»–é…ç½®åŒHTTPè™šæ‹Ÿä¸»æœº...
</VirtualHost>
```

### 5.5 æ€§èƒ½ä¼˜åŒ–é…ç½®


**æå‡è™šæ‹Ÿä¸»æœºæ€§èƒ½çš„é…ç½®**ï¼š

```apache
# å¯ç”¨å‹ç¼©æ¨¡å—
LoadModule deflate_module modules/mod_deflate.so

<VirtualHost *:80>
    ServerName www.mysite.com
    DocumentRoot /var/www/mysite/public
    
    # === å¼€å¯Gzipå‹ç¼© ===
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </Location>
    
    # === ç¼“å­˜é…ç½® ===
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header append Cache-Control "public, immutable"
    </LocationMatch>
    
    # === æ–‡ä»¶å‹ç¼© ===
    <LocationMatch "\.(html|css|js|xml|txt)$">
        SetOutputFilter DEFLATE
    </LocationMatch>
</VirtualHost>
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è™šæ‹Ÿä¸»æœºæœ¬è´¨ï¼šä¸€å°æœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªç‹¬ç«‹ç½‘ç«™çš„æŠ€æœ¯
ğŸ”¸ ä¸‰ç§ç±»å‹ï¼šåŸºäºåŸŸåï¼ˆæ¨èï¼‰ã€åŸºäºIPã€åŸºäºç«¯å£  
ğŸ”¸ æ ¸å¿ƒé…ç½®ï¼šServerNameã€DocumentRootã€Directoryæƒé™
ğŸ”¸ å®‰å…¨åŸåˆ™ï¼šæœ€å°æƒé™ã€ç¦ç”¨ç›®å½•æµè§ˆã€ä¿æŠ¤æ•æ„Ÿæ–‡ä»¶
ğŸ”¸ ç®¡ç†æ–¹å¼ï¼šsites-available/sites-enabledæ¨¡å¼ï¼ˆDebianç³»ï¼‰
```

### 6.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ é…ç½®æ–‡ä»¶ç»“æ„ç†è§£**ï¼š
```
VirtualHostå®¹å™¨ = ç½‘ç«™çš„ç‹¬ç«‹ç©ºé—´
â”œâ”€â”€ ServerName = ç½‘ç«™ä¸»åŸŸå
â”œâ”€â”€ DocumentRoot = ç½‘ç«™æ–‡ä»¶å­˜æ”¾ä½ç½®  
â”œâ”€â”€ Directory = ç›®å½•è®¿é—®æƒé™æ§åˆ¶
â””â”€â”€ æ—¥å¿—/SSLç­‰å…¶ä»–é…ç½®
```

**ğŸ”¹ å®‰å…¨é…ç½®åŸåˆ™**ï¼š
```
ç›®å½•æƒé™æ§åˆ¶ï¼š
- Options -Indexesï¼ˆç¦ç”¨ç›®å½•æµè§ˆï¼‰
- AllowOverrideé™åˆ¶.htaccessæƒé™
- Requireæ§åˆ¶è®¿é—®æ¥æº

æ–‡ä»¶ä¿æŠ¤ï¼š
- éšè—.htaccessã€.envç­‰æ•æ„Ÿæ–‡ä»¶
- è®¾ç½®åˆé€‚çš„æ–‡ä»¶ç³»ç»Ÿæƒé™
- å®šæœŸæ›´æ–°SSLè¯ä¹¦
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼š
```
å‡å°‘.htaccessæŸ¥æ‰¾ï¼š
- ç”Ÿäº§ç¯å¢ƒæ¨èAllowOverride None
- é…ç½®å†™å…¥è™šæ‹Ÿä¸»æœºæ–‡ä»¶ä¸­

å¯ç”¨ç¼“å­˜å’Œå‹ç¼©ï¼š
- é™æ€èµ„æºè®¾ç½®é•¿æœŸç¼“å­˜
- å¼€å¯Gzipå‹ç¼©èŠ‚çœå¸¦å®½
- ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


âœ… **å¿«é€Ÿä¸Šæ‰‹æ£€æŸ¥æ¸…å•**ï¼š
- [ ] ç†è§£ä¸‰ç§è™šæ‹Ÿä¸»æœºç±»å‹çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯
- [ ] èƒ½å¤Ÿç¼–å†™åŸºæœ¬çš„VirtualHosté…ç½®  
- [ ] æŒæ¡Directoryæƒé™æ§åˆ¶çš„å¸¸ç”¨é…ç½®
- [ ] äº†è§£.htaccessæ–‡ä»¶çš„ä½œç”¨å’Œæ€§èƒ½å½±å“
- [ ] ä¼šä½¿ç”¨a2ensite/a2dissiteç®¡ç†ç«™ç‚¹

ğŸ¯ **ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**ï¼š
- ä½¿ç”¨åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœºï¼ˆé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼‰
- ä¸ºæ¯ä¸ªç«™ç‚¹åˆ›å»ºç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶
- åˆç†è§„åˆ’ç›®å½•ç»“æ„ï¼Œä¾¿äºç®¡ç†å’Œå¤‡ä»½
- é…ç½®SSLè¯ä¹¦ï¼Œå¼ºåˆ¶ä½¿ç”¨HTTPS
- å®šæœŸæ£€æŸ¥å’Œæ›´æ–°å®‰å…¨é…ç½®

ğŸ“š **å­¦ä¹ è·¯å¾„å»ºè®®**ï¼š
1. **åŸºç¡€é˜¶æ®µ**ï¼šæŒæ¡è™šæ‹Ÿä¸»æœºæ¦‚å¿µå’ŒåŸºæœ¬é…ç½®
2. **è¿›é˜¶é˜¶æ®µ**ï¼šå­¦ä¹ å®‰å…¨é…ç½®å’Œæ€§èƒ½ä¼˜åŒ–
3. **é«˜çº§é˜¶æ®µ**ï¼šæ•´åˆè´Ÿè½½å‡è¡¡ã€SSLã€CDNç­‰æŠ€æœ¯

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è™šæ‹Ÿä¸»æœºå¤šç«™ç‚¹ï¼ŒåŸŸååŒºåˆ†æœ€å¸¸è§
- ServerNameå®šä¸»åŸŸï¼ŒDocumentRootæ”¾æ–‡ä»¶
- Directoryæ§æƒé™ï¼Œå®‰å…¨ç¬¬ä¸€è¦è®°ç‰¢
- sitesç®¡ç†åˆ†å¯ç¦ï¼Œæ—¥å¿—SSLä¸èƒ½å¿˜