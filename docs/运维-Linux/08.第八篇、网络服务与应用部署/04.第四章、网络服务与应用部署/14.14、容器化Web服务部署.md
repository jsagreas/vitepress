---
title: 14ã€å®¹å™¨åŒ–WebæœåŠ¡éƒ¨ç½²
---
## ğŸ“š ç›®å½•

1. [DockeråŒ–Nginx/Apacheéƒ¨ç½²](#1-DockeråŒ–NginxApacheéƒ¨ç½²)
2. [å®¹å™¨é•œåƒæ„å»ºæœ€ä½³å®è·µ](#2-å®¹å™¨é•œåƒæ„å»ºæœ€ä½³å®è·µ)
3. [å®¹å™¨ç½‘ç»œé…ç½®](#3-å®¹å™¨ç½‘ç»œé…ç½®)
4. [æ•°æ®å·æŒ‚è½½ç­–ç•¥](#4-æ•°æ®å·æŒ‚è½½ç­–ç•¥)
5. [ç¯å¢ƒå˜é‡é…ç½®ç®¡ç†](#5-ç¯å¢ƒå˜é‡é…ç½®ç®¡ç†)
6. [å¤šå®¹å™¨ç¼–æ’é…ç½®](#6-å¤šå®¹å™¨ç¼–æ’é…ç½®)
7. [å®¹å™¨å¥åº·æ£€æŸ¥](#7-å®¹å™¨å¥åº·æ£€æŸ¥)
8. [æ»šåŠ¨æ›´æ–°éƒ¨ç½²](#8-æ»šåŠ¨æ›´æ–°éƒ¨ç½²)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ³ DockeråŒ–Nginx/Apacheéƒ¨ç½²


### 1.1 Dockerå®¹å™¨åŒ–åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å®¹å™¨åŒ–éƒ¨ç½²ï¼Ÿ**
> å®¹å™¨åŒ–å°±åƒæŠŠåº”ç”¨ç¨‹åº"æ‰“åŒ…æˆé›†è£…ç®±"ï¼Œé‡Œé¢åŒ…å«äº†è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¸œè¥¿ï¼šä»£ç ã€è¿è¡Œç¯å¢ƒã€ä¾èµ–åº“ç­‰ã€‚æ— è®ºåœ¨å“ªå°æœºå™¨ä¸Šï¼Œè¿™ä¸ª"é›†è£…ç®±"éƒ½èƒ½æ­£å¸¸è¿è¡Œã€‚

```
ä¼ ç»Ÿéƒ¨ç½² vs å®¹å™¨åŒ–éƒ¨ç½²ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼š
æœåŠ¡å™¨ç¯å¢ƒ â†’ å®‰è£…è½¯ä»¶ â†’ é…ç½®ç¯å¢ƒ â†’ éƒ¨ç½²åº”ç”¨
é—®é¢˜ï¼šç¯å¢ƒå·®å¼‚ã€ä¾èµ–å†²çªã€è¿ç§»å›°éš¾

å®¹å™¨åŒ–æ–¹å¼ï¼š
é•œåƒæ„å»º â†’ å®¹å™¨è¿è¡Œ â†’ åº”ç”¨æœåŠ¡
ä¼˜åŠ¿ï¼šç¯å¢ƒä¸€è‡´ã€éš”ç¦»æ€§å¥½ã€æ˜“äºè¿ç§»
```

### 1.2 Nginxå®¹å™¨åŒ–éƒ¨ç½²


#### ğŸ”¸ åŸºç¡€Nginxå®¹å™¨éƒ¨ç½²

```bash
# æ‹‰å–å®˜æ–¹Nginxé•œåƒ
docker pull nginx:alpine

# å¿«é€Ÿå¯åŠ¨Nginxå®¹å™¨
docker run -d \
  --name my-nginx \
  -p 80:80 \
  nginx:alpine

# éªŒè¯æœåŠ¡è¿è¡Œ
curl http://localhost
```

**éƒ¨ç½²è¿‡ç¨‹è§£æï¼š**
```
docker runå‚æ•°è¯´æ˜ï¼š
-d              â†’ åå°è¿è¡Œï¼ˆdetachedæ¨¡å¼ï¼‰
--name my-nginx â†’ ç»™å®¹å™¨èµ·åå­—ï¼Œä¾¿äºç®¡ç†
-p 80:80       â†’ ç«¯å£æ˜ å°„ï¼šä¸»æœº80ç«¯å£ â†’ å®¹å™¨80ç«¯å£
nginx:alpine   â†’ ä½¿ç”¨çš„é•œåƒï¼ˆAlpineç‰ˆæœ¬æ›´è½»é‡ï¼‰

å®¹å™¨å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼š
1. å¯åŠ¨Nginxä¸»è¿›ç¨‹
2. ç›‘å¬å®¹å™¨å†…éƒ¨80ç«¯å£
3. é€šè¿‡Dockerç½‘ç»œå¯¹å¤–æä¾›æœåŠ¡
```

#### ğŸ”¸ è‡ªå®šä¹‰é…ç½®éƒ¨ç½²

```bash
# æŒ‚è½½è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
docker run -d \
  --name nginx-custom \
  -p 8080:80 \
  -v /host/nginx.conf:/etc/nginx/nginx.conf:ro \
  -v /host/html:/usr/share/nginx/html:ro \
  nginx:alpine

# æŒ‚è½½æ•´ä¸ªé…ç½®ç›®å½•
docker run -d \
  --name nginx-full \
  -p 80:80 \
  -v /host/nginx-config:/etc/nginx \
  -v /host/webroot:/var/www/html \
  nginx:alpine
```

### 1.3 Apacheå®¹å™¨åŒ–éƒ¨ç½²


#### ğŸ”¸ åŸºç¡€Apacheéƒ¨ç½²

```bash
# ä½¿ç”¨å®˜æ–¹Apacheé•œåƒ
docker run -d \
  --name my-apache \
  -p 8080:80 \
  httpd:alpine

# æŸ¥çœ‹Apacheé»˜è®¤é¡µé¢
curl http://localhost:8080
```

#### ğŸ”¸ Apacheè‡ªå®šä¹‰éƒ¨ç½²

```bash
# æŒ‚è½½ç½‘ç«™å†…å®¹å’Œé…ç½®
docker run -d \
  --name apache-site \
  -p 80:80 \
  -v /host/website:/usr/local/apache2/htdocs \
  -v /host/apache-config:/usr/local/apache2/conf \
  httpd:2.4
```

### 1.4 å®¹å™¨åŒ–éƒ¨ç½²çš„æ ¸å¿ƒä¼˜åŠ¿


**ä¸ºä»€ä¹ˆé€‰æ‹©å®¹å™¨åŒ–ï¼Ÿ**

| ä¼ ç»Ÿéƒ¨ç½² | å®¹å™¨åŒ–éƒ¨ç½² | **æ ¸å¿ƒä¼˜åŠ¿** |
|---------|-----------|-------------|
| ç¯å¢ƒé…ç½®å¤æ‚ | é•œåƒæ‰“åŒ…ä¸€åˆ‡ | `ä¸€æ¬¡æ„å»ºï¼Œå¤„å¤„è¿è¡Œ` |
| èµ„æºå ç”¨å¤§ | è½»é‡çº§éš”ç¦» | `æ›´é«˜çš„èµ„æºåˆ©ç”¨ç‡` |
| æ‰©å±•å›°éš¾ | ç§’çº§æ‰©å®¹ | `å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›` |
| å›æ»šå¤æ‚ | ç‰ˆæœ¬åŒ–ç®¡ç† | `å¿«é€Ÿå›æ»šå’Œæ›´æ–°` |

**å®é™…åº”ç”¨åœºæ™¯ï¼š**
```
ğŸ¯ å¼€å‘ç¯å¢ƒï¼š
ä¼˜åŠ¿ï¼šå¿«é€Ÿæ­å»ºã€ç¯å¢ƒä¸€è‡´ã€å›¢é˜Ÿåä½œ
å‘½ä»¤ï¼šdocker run -d -p 3000:80 nginx:alpine

ğŸ¯ æµ‹è¯•ç¯å¢ƒï¼š  
ä¼˜åŠ¿ï¼šç¯å¢ƒéš”ç¦»ã€å¿«é€Ÿé‡ç½®ã€å¹¶è¡Œæµ‹è¯•
å‘½ä»¤ï¼šdocker run --rm -p 8080:80 my-app:test

ğŸ¯ ç”Ÿäº§ç¯å¢ƒï¼š
ä¼˜åŠ¿ï¼šé«˜å¯ç”¨ã€è‡ªåŠ¨æ‰©ç¼©ã€ç›‘æ§å®Œå–„
æ–¹æ¡ˆï¼šKubernetes + Dockeré•œåƒ
```

---

## 2. ğŸ”¨ å®¹å™¨é•œåƒæ„å»ºæœ€ä½³å®è·µ


### 2.1 é•œåƒæ„å»ºåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯Dockeré•œåƒï¼Ÿ**
> é•œåƒå°±åƒ"è½¯ä»¶å®‰è£…åŒ…"ï¼ŒåŒ…å«äº†è¿è¡Œåº”ç”¨æ‰€éœ€çš„å®Œæ•´ç¯å¢ƒã€‚ä½†ä¸ä¼ ç»Ÿå®‰è£…åŒ…ä¸åŒï¼Œé•œåƒæ˜¯**åˆ†å±‚å­˜å‚¨**çš„ï¼Œå¯ä»¥å¤ç”¨å’Œä¼˜åŒ–ã€‚

```
é•œåƒåˆ†å±‚åŸç†ï¼š
åŸºç¡€å±‚ï¼šæ“ä½œç³»ç»Ÿ (alpine linux)
â”œâ”€ è¿è¡Œæ—¶å±‚ï¼šnginxè½¯ä»¶åŒ…
â”œâ”€ é…ç½®å±‚ï¼šnginxé…ç½®æ–‡ä»¶  
â”œâ”€ åº”ç”¨å±‚ï¼šç½‘ç«™æ–‡ä»¶
â””â”€ å¯åŠ¨å±‚ï¼šå¯åŠ¨å‘½ä»¤

æ¯ä¸€å±‚éƒ½å¯ä»¥å¤ç”¨ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼
```

### 2.2 Dockerfileç¼–å†™æœ€ä½³å®è·µ


#### ğŸ”¸ é«˜æ•ˆçš„Dockerfileç»“æ„

```dockerfile
# é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ
FROM nginx:alpine AS base

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶é…ç½®æ–‡ä»¶ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
COPY nginx.conf /etc/nginx/nginx.conf

# å¤åˆ¶ç½‘ç«™æ–‡ä»¶
COPY ./html /usr/share/nginx/html

# åˆ›å»ºå¿…è¦çš„ç›®å½•
RUN mkdir -p /var/log/nginx && \
    chown -R nginx:nginx /var/log/nginx

# æš´éœ²ç«¯å£
EXPOSE 80

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s \
  CMD curl -f http://localhost/ || exit 1

# å¯åŠ¨å‘½ä»¤
CMD ["nginx", "-g", "daemon off;"]
```

#### ğŸ”¸ å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–

```dockerfile
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºåº”ç”¨
FROM node:16-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

# ç¬¬äºŒé˜¶æ®µï¼šç”Ÿäº§é•œåƒ
FROM nginx:alpine AS production
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

**å¤šé˜¶æ®µæ„å»ºçš„ä¼˜åŠ¿ï¼š**
```
å•é˜¶æ®µæ„å»ºé—®é¢˜ï¼š
é•œåƒå¤§å°ï¼šåŒ…å«Node.js + npm + æºç  = 500MB
å®‰å…¨é£é™©ï¼šåŒ…å«å¼€å‘å·¥å…·å’Œæºç 

å¤šé˜¶æ®µæ„å»ºä¼˜åŠ¿ï¼š
æœ€ç»ˆé•œåƒï¼šåªåŒ…å«æ„å»ºäº§ç‰© + Nginx = 50MB
å®‰å…¨æ€§ï¼šä¸åŒ…å«æºç å’Œå¼€å‘å·¥å…·
æ¸…æ´æ€§ï¼šåªä¿ç•™è¿è¡Œå¿…éœ€çš„å†…å®¹
```

### 2.3 é•œåƒä¼˜åŒ–ç­–ç•¥


#### ğŸ”¸ å‡å°é•œåƒå¤§å°

```dockerfile
# âŒ ä¸å¥½çš„åšæ³•
FROM ubuntu:20.04
RUN apt-get update
RUN apt-get install -y nginx
RUN apt-get install -y curl
RUN apt-get clean

# âœ… ä¼˜åŒ–åçš„åšæ³•
FROM alpine:3.16
RUN apk add --no-cache nginx curl && \
    rm -rf /var/cache/apk/*
```

#### ğŸ”¸ åˆ©ç”¨æ„å»ºç¼“å­˜

```dockerfile
# âœ… æ­£ç¡®çš„æ–‡ä»¶å¤åˆ¶é¡ºåº
# å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼ˆå˜åŒ–é¢‘ç‡ä½ï¼‰
COPY package*.json ./
RUN npm ci --only=production

# å†å¤åˆ¶æºç ï¼ˆå˜åŒ–é¢‘ç‡é«˜ï¼‰
COPY . .
RUN npm run build
```

**ç¼“å­˜æœºåˆ¶è¯´æ˜ï¼š**
```
Dockeræ„å»ºç¼“å­˜åŸç†ï¼š
æ¯ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å±‚
å¦‚æœæŒ‡ä»¤å’Œè¾“å…¥æ²¡å˜åŒ–ï¼Œå°±å¤ç”¨ç¼“å­˜
ä¸€æ—¦æŸå±‚å˜åŒ–ï¼Œåç»­æ‰€æœ‰å±‚éƒ½è¦é‡å»º

ä¼˜åŒ–ç­–ç•¥ï¼š
1. æŠŠå˜åŒ–å°‘çš„æ“ä½œæ”¾å‰é¢
2. æŠŠå˜åŒ–å¤šçš„æ“ä½œæ”¾åé¢  
3. åˆå¹¶RUNæŒ‡ä»¤å‡å°‘å±‚æ•°
4. åŠæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶
```

### 2.4 å®‰å…¨æ€§æœ€ä½³å®è·µ


#### ğŸ”¸ érootç”¨æˆ·è¿è¡Œ

```dockerfile
# åˆ›å»ºä¸“ç”¨ç”¨æˆ·
RUN addgroup -g 1001 -S nginx && \
    adduser -u 1001 -D -S -G nginx nginx

# è®¾ç½®æ–‡ä»¶æƒé™
RUN chown -R nginx:nginx /usr/share/nginx/html && \
    chown -R nginx:nginx /var/log/nginx

# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER nginx

# ä½¿ç”¨éç‰¹æƒç«¯å£
EXPOSE 8080
```

#### ğŸ”¸ æ•æ„Ÿä¿¡æ¯å¤„ç†

```dockerfile
# âŒ ä¸è¦åœ¨é•œåƒä¸­å­˜å‚¨å¯†é’¥
# ENV API_KEY=secret123

# âœ… ä½¿ç”¨æ„å»ºå‚æ•°å’Œè¿è¡Œæ—¶ç¯å¢ƒå˜é‡
ARG BUILD_VERSION
ENV APP_VERSION=${BUILD_VERSION}

# âœ… æ•æ„Ÿé…ç½®é€šè¿‡æŒ‚è½½æä¾›
VOLUME ["/etc/nginx/ssl"]
```

### 2.5 é•œåƒæ ‡ç­¾ç­–ç•¥


```bash
# ğŸ·ï¸ æœ‰æ„ä¹‰çš„æ ‡ç­¾å‘½å
docker build -t myapp:1.2.3 .           # ç‰ˆæœ¬å·
docker build -t myapp:latest .          # æœ€æ–°ç‰ˆ
docker build -t myapp:dev-20230917 .    # å¼€å‘ç‰ˆæœ¬

# ğŸ·ï¸ å¤šæ ‡ç­¾ç­–ç•¥
docker tag myapp:1.2.3 myapp:stable
docker tag myapp:1.2.3 registry.company.com/myapp:1.2.3
```

**æ ‡ç­¾ç®¡ç†æœ€ä½³å®è·µï¼š**
```
æ ‡ç­¾å‘½åè§„èŒƒï¼š
ğŸ¯ ç‰ˆæœ¬æ ‡ç­¾ï¼šv1.2.3, 2023.09.17
ğŸ¯ ç¯å¢ƒæ ‡ç­¾ï¼šdev, test, prod  
ğŸ¯ åŠŸèƒ½æ ‡ç­¾ï¼šnginx-ssl, apache-php
ğŸ¯ ç‰¹æ®Šæ ‡ç­¾ï¼šlatest, stable, beta

æ ‡ç­¾ä½¿ç”¨åŸåˆ™ï¼š
â€¢ latestæ ‡ç­¾ç”¨äºæœ€æ–°ç¨³å®šç‰ˆ
â€¢ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å…·ä½“ç‰ˆæœ¬å·
â€¢ å¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨latest
â€¢ åŠæ—¶æ¸…ç†è¿‡æœŸé•œåƒèŠ‚çœç©ºé—´
```

---

## 3. ğŸŒ å®¹å™¨ç½‘ç»œé…ç½®


### 3.1 Dockerç½‘ç»œåŸºæœ¬æ¦‚å¿µ


**å®¹å™¨ç½‘ç»œæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**
> å®¹å™¨ç½‘ç»œå°±åƒ"è™šæ‹Ÿå±€åŸŸç½‘"ï¼ŒDockerä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…IPåœ°å€ï¼Œé€šè¿‡è™šæ‹Ÿç½‘æ¡¥è¿æ¥å®¹å™¨ï¼Œå®ç°å®¹å™¨é—´å’Œå®¹å™¨ä¸å¤–éƒ¨çš„é€šä¿¡ã€‚

```
Dockerç½‘ç»œæ¶æ„ï¼š
å®¿ä¸»æœº (192.168.1.100)
â”œâ”€ docker0ç½‘æ¡¥ (172.17.0.1)
â”œâ”€ å®¹å™¨A (172.17.0.2)
â”œâ”€ å®¹å™¨B (172.17.0.3)
â””â”€ å®¹å™¨C (172.17.0.4)

é€šä¿¡è·¯å¾„ï¼š
å¤–éƒ¨ â†’ å®¿ä¸»æœº â†’ docker0 â†’ å®¹å™¨
å®¹å™¨A â†’ docker0 â†’ å®¹å™¨B
```

### 3.2 Dockerç½‘ç»œæ¨¡å¼è¯¦è§£


#### ğŸ”¸ æ¡¥æ¥ç½‘ç»œï¼ˆBridgeï¼‰- é»˜è®¤æ¨¡å¼

```bash
# æŸ¥çœ‹é»˜è®¤ç½‘ç»œ
docker network ls
# NETWORK ID   NAME      DRIVER    SCOPE
# xxx          bridge    bridge    local

# åœ¨æ¡¥æ¥ç½‘ç»œä¸­è¿è¡Œå®¹å™¨
docker run -d --name web1 nginx:alpine
docker run -d --name web2 nginx:alpine

# å®¹å™¨é—´å¯ä»¥é€šè¿‡IPé€šä¿¡
docker exec web1 ping 172.17.0.3  # web2çš„IP
```

#### ğŸ”¸ è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œ

```bash
# åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ
docker network create --driver bridge my-network

# åœ¨è‡ªå®šä¹‰ç½‘ç»œä¸­è¿è¡Œå®¹å™¨
docker run -d --name web1 --network my-network nginx:alpine
docker run -d --name web2 --network my-network nginx:alpine

# å®¹å™¨é—´å¯ä»¥é€šè¿‡åç§°é€šä¿¡ï¼ˆDNSè§£æï¼‰
docker exec web1 ping web2  # ç›´æ¥ä½¿ç”¨å®¹å™¨å
```

**è‡ªå®šä¹‰ç½‘ç»œçš„ä¼˜åŠ¿ï¼š**
```
é»˜è®¤bridgeç½‘ç»œé™åˆ¶ï¼š
â€¢ å®¹å™¨é—´åªèƒ½é€šè¿‡IPé€šä¿¡
â€¢ éœ€è¦æ‰‹åŠ¨ç®¡ç†IPåœ°å€
â€¢ å®‰å…¨æ€§ç›¸å¯¹è¾ƒä½

è‡ªå®šä¹‰bridgeç½‘ç»œä¼˜åŠ¿ï¼š
â€¢ è‡ªåŠ¨DNSè§£æï¼ˆå®¹å™¨å â†’ IPï¼‰
â€¢ æ›´å¥½çš„éš”ç¦»æ€§
â€¢ å¯ä»¥åŠ¨æ€è¿æ¥/æ–­å¼€å®¹å™¨
â€¢ æ”¯æŒç½‘ç»œåˆ«å
```

#### ğŸ”¸ ä¸»æœºç½‘ç»œï¼ˆHostï¼‰

```bash
# ä½¿ç”¨ä¸»æœºç½‘ç»œ
docker run -d --name web-host --network host nginx:alpine

# å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œæ ˆ
# è®¿é—® localhost:80 ç›´æ¥è®¿é—®å®¹å™¨æœåŠ¡
curl http://localhost
```

**ä¸»æœºç½‘ç»œçš„ç‰¹ç‚¹ï¼š**
```
ä¼˜åŠ¿ï¼š
â€¢ æ€§èƒ½æœ€é«˜ï¼ˆæ— ç½‘ç»œè½¬å‘å¼€é”€ï¼‰
â€¢ é…ç½®ç®€å•
â€¢ é€‚åˆéœ€è¦è®¿é—®ä¸»æœºç½‘ç»œæœåŠ¡çš„åœºæ™¯

åŠ£åŠ¿ï¼š
â€¢ å¤±å»ç½‘ç»œéš”ç¦»æ€§
â€¢ ç«¯å£å†²çªé£é™©
â€¢ å®‰å…¨æ€§è¾ƒä½
```

### 3.3 ç«¯å£æ˜ å°„ç­–ç•¥


#### ğŸ”¸ é™æ€ç«¯å£æ˜ å°„

```bash
# æŒ‡å®šç«¯å£æ˜ å°„
docker run -d -p 8080:80 nginx:alpine        # ä¸»æœº8080 â†’ å®¹å™¨80
docker run -d -p 443:443 nginx:alpine        # ä¸»æœº443 â†’ å®¹å™¨443
docker run -d -p 127.0.0.1:3000:80 nginx:alpine  # åªç»‘å®šæœ¬åœ°æ¥å£
```

#### ğŸ”¸ åŠ¨æ€ç«¯å£æ˜ å°„

```bash
# Dockerè‡ªåŠ¨åˆ†é…ç«¯å£
docker run -d -P nginx:alpine

# æŸ¥çœ‹åˆ†é…çš„ç«¯å£
docker port container_name
# 80/tcp -> 0.0.0.0:32768
```

#### ğŸ”¸ å¤šç«¯å£æ˜ å°„

```bash
# æ˜ å°„å¤šä¸ªç«¯å£
docker run -d \
  -p 80:80 \
  -p 443:443 \
  -p 8080:8080 \
  my-multi-port-app
```

### 3.4 è´Ÿè½½å‡è¡¡ç½‘ç»œé…ç½®


**å®¹å™¨çº§è´Ÿè½½å‡è¡¡å®ç°ï¼š**
```bash
# å¯åŠ¨å¤šä¸ªWebæœåŠ¡å®¹å™¨
docker run -d --name web1 -p 8081:80 nginx:alpine
docker run -d --name web2 -p 8082:80 nginx:alpine  
docker run -d --name web3 -p 8083:80 nginx:alpine

# ä½¿ç”¨Nginxä½œä¸ºè´Ÿè½½å‡è¡¡å™¨
# nginx.confé…ç½®
upstream backend {
    server host.docker.internal:8081;
    server host.docker.internal:8082;
    server host.docker.internal:8083;
}

server {
    listen 80;
    location / {
        proxy_pass http://backend;
    }
}
```

### 3.5 ç½‘ç»œå®‰å…¨é…ç½®


#### ğŸ”¸ ç½‘ç»œéš”ç¦»ç­–ç•¥

```bash
# åˆ›å»ºå‰ç«¯ç½‘ç»œ
docker network create frontend-net

# åˆ›å»ºåç«¯ç½‘ç»œ  
docker network create backend-net

# å‰ç«¯å®¹å™¨åªè¿æ¥å‰ç«¯ç½‘ç»œ
docker run -d --name nginx --network frontend-net nginx:alpine

# åº”ç”¨å®¹å™¨è¿æ¥ä¸¤ä¸ªç½‘ç»œ
docker run -d --name app my-app:latest
docker network connect frontend-net app
docker network connect backend-net app

# æ•°æ®åº“åªè¿æ¥åç«¯ç½‘ç»œ
docker run -d --name db --network backend-net mysql:8.0
```

**ç½‘ç»œéš”ç¦»çš„å®‰å…¨ä»·å€¼ï¼š**
```
ä¸‰å±‚ç½‘ç»œæ¶æ„ï¼š
å‰ç«¯å±‚ï¼šNginx (frontend-net)
â”‚
åº”ç”¨å±‚ï¼šApp Server (frontend-net + backend-net)  
â”‚
æ•°æ®å±‚ï¼šDatabase (backend-net)

å®‰å…¨æ•ˆæœï¼š
â€¢ å‰ç«¯æ— æ³•ç›´æ¥è®¿é—®æ•°æ®åº“
â€¢ æ•°æ®åº“æ— æ³•è¢«å¤–éƒ¨ç›´æ¥è®¿é—®
â€¢ åº”ç”¨æœåŠ¡ä½œä¸ºå®‰å…¨ç½‘å…³
```

---

## 4. ğŸ’¾ æ•°æ®å·æŒ‚è½½ç­–ç•¥


### 4.1 æ•°æ®æŒä¹…åŒ–åŸºæœ¬æ¦‚å¿µ


**ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®å·ï¼Ÿ**
> å®¹å™¨å°±åƒ"ä¸´æ—¶å¸ç¯·"ï¼Œå®¹å™¨åˆ é™¤åæ•°æ®å°±ä¸¢å¤±äº†ã€‚æ•°æ®å·å°±åƒ"æ°¸ä¹…ä»“åº“"ï¼Œå³ä½¿å¸ç¯·æ‹†æ‰ï¼Œé‡è¦ç‰©å“è¿˜åœ¨ä»“åº“é‡Œå®‰å…¨ä¿å­˜ã€‚

```
å®¹å™¨æ•°æ®å±‚æ¬¡ï¼š
å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ (ä¸´æ—¶) â”€â”€ å®¹å™¨åˆ é™¤æ—¶ä¸¢å¤±
â”œâ”€ åº”ç”¨ç¨‹åºæ–‡ä»¶
â”œâ”€ ä¸´æ—¶æ•°æ®æ–‡ä»¶  
â””â”€ è¿è¡Œæ—¶æ•°æ®

æ•°æ®å· (æŒä¹…) â”€â”€â”€â”€â”€â”€ ç‹¬ç«‹äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸ
â”œâ”€ é…ç½®æ–‡ä»¶
â”œâ”€ ç”¨æˆ·æ•°æ®
â””â”€ æ—¥å¿—æ–‡ä»¶
```

### 4.2 æŒ‚è½½æ–¹å¼å¯¹æ¯”


#### ğŸ”¸ ç»‘å®šæŒ‚è½½ï¼ˆBind Mountï¼‰

```bash
# æŒ‚è½½ä¸»æœºç›®å½•åˆ°å®¹å™¨
docker run -d \
  --name nginx-bind \
  -v /host/nginx.conf:/etc/nginx/nginx.conf:ro \
  -v /host/html:/usr/share/nginx/html \
  -p 80:80 \
  nginx:alpine
```

**ç»‘å®šæŒ‚è½½ç‰¹ç‚¹ï¼š**
```
ä¼˜åŠ¿ï¼š
â€¢ ç›´æ¥ä½¿ç”¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿ
â€¢ å¯ä»¥ç›´æ¥ç¼–è¾‘ä¸»æœºæ–‡ä»¶
â€¢ è·¯å¾„æ˜ç¡®ï¼Œä¾¿äºè°ƒè¯•

åŠ£åŠ¿ï¼š  
â€¢ ä¾èµ–ä¸»æœºè·¯å¾„ç»“æ„
â€¢ è·¨å¹³å°å…¼å®¹æ€§å·®
â€¢ å®‰å…¨æ€§ç›¸å¯¹è¾ƒä½

é€‚ç”¨åœºæ™¯ï¼š
â€¢ å¼€å‘ç¯å¢ƒé…ç½®æŒ‚è½½
â€¢ æ—¥å¿—æ–‡ä»¶è¾“å‡º
â€¢ ä¸´æ—¶æ•°æ®å…±äº«
```

#### ğŸ”¸ å‘½åå·ï¼ˆNamed Volumeï¼‰

```bash
# åˆ›å»ºå‘½åå·
docker volume create nginx-config
docker volume create nginx-logs

# ä½¿ç”¨å‘½åå·
docker run -d \
  --name nginx-volume \
  -v nginx-config:/etc/nginx \
  -v nginx-logs:/var/log/nginx \
  -p 80:80 \
  nginx:alpine

# æŸ¥çœ‹å·ä¿¡æ¯
docker volume inspect nginx-config
```

**å‘½åå·ç‰¹ç‚¹ï¼š**
```
ä¼˜åŠ¿ï¼š
â€¢ ç”±Dockerç®¡ç†ï¼Œè·¨å¹³å°å…¼å®¹
â€¢ å¯ä»¥åœ¨å®¹å™¨é—´å…±äº«
â€¢ æ”¯æŒå¤‡ä»½å’Œè¿ç§»
â€¢ æ›´å¥½çš„å®‰å…¨æ€§

é€‚ç”¨åœºæ™¯ï¼š
â€¢ ç”Ÿäº§ç¯å¢ƒæ•°æ®å­˜å‚¨
â€¢ æ•°æ®åº“æ–‡ä»¶å­˜å‚¨  
â€¢ é…ç½®æ–‡ä»¶ç®¡ç†
â€¢ å®¹å™¨é—´æ•°æ®å…±äº«
```

#### ğŸ”¸ ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼ˆtmpfsï¼‰

```bash
# æŒ‚è½½å†…å­˜æ–‡ä»¶ç³»ç»Ÿ
docker run -d \
  --name nginx-tmpfs \
  --tmpfs /tmp:rw,noexec,nosuid,size=1g \
  nginx:alpine
```

### 4.3 WebæœåŠ¡æ•°æ®æŒ‚è½½ç­–ç•¥


#### ğŸ”¸ Nginxæ•°æ®æŒ‚è½½æœ€ä½³å®è·µ

```bash
# å®Œæ•´çš„Nginxæ•°æ®æŒ‚è½½
docker run -d \
  --name nginx-production \
  -p 80:80 \
  -p 443:443 \
  -v nginx-config:/etc/nginx:ro \
  -v nginx-ssl:/etc/nginx/ssl:ro \
  -v web-content:/usr/share/nginx/html:ro \
  -v nginx-logs:/var/log/nginx \
  --restart unless-stopped \
  nginx:alpine
```

**æŒ‚è½½ç‚¹åŠŸèƒ½è¯´æ˜ï¼š**
```
/etc/nginx â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»é…ç½®æ–‡ä»¶ (åªè¯»)
â”œâ”€ nginx.conf        ä¸»é…ç½®
â”œâ”€ conf.d/          è™šæ‹Ÿä¸»æœºé…ç½®
â””â”€ ssl/             SSLè¯ä¹¦

/usr/share/nginx/html â”€â”€ ç½‘ç«™å†…å®¹ (åªè¯»)
â”œâ”€ index.html        ä¸»é¡µ
â”œâ”€ assets/          é™æ€èµ„æº
â””â”€ api/             APIæ–‡ä»¶

/var/log/nginx â”€â”€â”€â”€ æ—¥å¿—æ–‡ä»¶ (è¯»å†™)
â”œâ”€ access.log       è®¿é—®æ—¥å¿—
â””â”€ error.log        é”™è¯¯æ—¥å¿—
```

#### ğŸ”¸ Apacheæ•°æ®æŒ‚è½½é…ç½®

```bash
# Apacheå®¹å™¨æ•°æ®æŒ‚è½½
docker run -d \
  --name apache-prod \
  -p 80:80 \
  -v apache-config:/usr/local/apache2/conf \
  -v web-docroot:/usr/local/apache2/htdocs \
  -v apache-logs:/usr/local/apache2/logs \
  httpd:2.4
```

### 4.4 æ•°æ®å¤‡ä»½ä¸æ¢å¤


#### ğŸ”¸ æ•°æ®å·å¤‡ä»½

```bash
# å¤‡ä»½å‘½åå·æ•°æ®
docker run --rm \
  -v nginx-config:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/nginx-config-backup.tar.gz -C /data .

# æ¢å¤æ•°æ®å·
docker run --rm \
  -v nginx-config:/data \
  -v $(pwd):/backup \
  alpine tar xzf /backup/nginx-config-backup.tar.gz -C /data
```

#### ğŸ”¸ æ•°æ®åº“å·å¤‡ä»½ç¤ºä¾‹

```bash
# å¤‡ä»½MySQLæ•°æ®å·
docker run --rm \
  -v mysql-data:/var/lib/mysql \
  -v $(pwd):/backup \
  mysql:8.0 \
  mysqldump -u root -p --all-databases > /backup/mysql-backup.sql
```

### 4.5 æŒ‚è½½å®‰å…¨é…ç½®


```bash
# åªè¯»æŒ‚è½½ï¼ˆé…ç½®æ–‡ä»¶ï¼‰
-v /host/config:/app/config:ro

# æŒ‡å®šç”¨æˆ·æƒé™
-v /host/data:/app/data:Z  # SELinuxæ ‡ç­¾

# é™åˆ¶æŒ‚è½½æƒé™
--tmpfs /tmp:rw,noexec,nosuid,size=1g

# ä½¿ç”¨éç‰¹æƒç”¨æˆ·
USER 1001:1001
```

**æ•°æ®å®‰å…¨æœ€ä½³å®è·µï¼š**
```
ğŸ”’ å®‰å…¨åŸåˆ™ï¼š
â€¢ é…ç½®æ–‡ä»¶ä½¿ç”¨åªè¯»æŒ‚è½½
â€¢ æ•æ„Ÿæ•°æ®ç‹¬ç«‹å­˜å‚¨
â€¢ å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
â€¢ ä½¿ç”¨å…·åå·ç®¡ç†æ•°æ®

ğŸ”’ æƒé™æ§åˆ¶ï¼š
â€¢ å®¹å™¨å†…ä½¿ç”¨érootç”¨æˆ·
â€¢ è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™
â€¢ é¿å…æŒ‚è½½æ•æ„Ÿçš„ä¸»æœºç›®å½•
â€¢ ä½¿ç”¨å®‰å…¨æ‰«æå·¥å…·æ£€æŸ¥
```

---

## 5. âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®ç®¡ç†


### 5.1 ç¯å¢ƒå˜é‡åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡é…ç½®ï¼Ÿ**
> ç¯å¢ƒå˜é‡å°±åƒ"é¥æ§å™¨è®¾ç½®"ï¼Œä¸ç”¨ä¿®æ”¹ç¨‹åºä»£ç ï¼Œå°±èƒ½æ”¹å˜ç¨‹åºçš„è¡Œä¸ºã€‚åœ¨å®¹å™¨ä¸­ï¼Œå®ƒæ˜¯å®ç°"ä¸€æ¬¡æ„å»ºï¼Œå¤šç¯å¢ƒè¿è¡Œ"çš„å…³é”®æŠ€æœ¯ã€‚

```
ä¼ ç»Ÿé…ç½® vs ç¯å¢ƒå˜é‡é…ç½®ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼š
ä»£ç ä¸­å†™æ­»é…ç½® â†’ ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒä»£ç  â†’ éƒ¨ç½²å¤æ‚

ç¯å¢ƒå˜é‡æ–¹å¼ï¼š  
ä»£ç è¯»å–ç¯å¢ƒå˜é‡ â†’ åŒä¸€é•œåƒä¸åŒé…ç½® â†’ çµæ´»éƒ¨ç½²

ç¤ºä¾‹ï¼š
database_host = os.getenv('DB_HOST', 'localhost')
database_port = os.getenv('DB_PORT', '3306')
```

### 5.2 å®¹å™¨ç¯å¢ƒå˜é‡è®¾ç½®


#### ğŸ”¸ è¿è¡Œæ—¶è®¾ç½®ç¯å¢ƒå˜é‡

```bash
# å•ä¸ªç¯å¢ƒå˜é‡
docker run -d \
  --name nginx-custom \
  -e NGINX_HOST=example.com \
  -e NGINX_PORT=80 \
  -p 80:80 \
  nginx:alpine

# å¤šä¸ªç¯å¢ƒå˜é‡
docker run -d \
  --name web-app \
  -e DB_HOST=mysql-server \
  -e DB_PORT=3306 \
  -e DB_NAME=webapp \
  -e DB_USER=app_user \
  -e APP_ENV=production \
  my-web-app:latest
```

#### ğŸ”¸ ç¯å¢ƒå˜é‡æ–‡ä»¶

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶ .env
cat > .env << EOF
DB_HOST=mysql-server
DB_PORT=3306
DB_NAME=webapp
DB_USER=app_user
APP_ENV=production
NGINX_WORKER_PROCESSES=4
NGINX_WORKER_CONNECTIONS=1024
EOF

# ä½¿ç”¨ç¯å¢ƒå˜é‡æ–‡ä»¶
docker run -d \
  --name web-app \
  --env-file .env \
  -p 80:80 \
  my-web-app:latest
```

### 5.3 é…ç½®æ¨¡æ¿åŒ–


#### ğŸ”¸ Nginxé…ç½®æ¨¡æ¿åŒ–

```bash
# åˆ›å»ºNginxé…ç½®æ¨¡æ¿ nginx.conf.template
server {
    listen ${NGINX_PORT};
    server_name ${NGINX_HOST};
    
    worker_processes ${NGINX_WORKER_PROCESSES};
    
    location / {
        proxy_pass http://${BACKEND_HOST}:${BACKEND_PORT};
        proxy_set_header Host $host;
    }
}
```

```dockerfile
# Dockerfileä¸­å¤„ç†æ¨¡æ¿
FROM nginx:alpine

COPY nginx.conf.template /etc/nginx/templates/
COPY docker-entrypoint.sh /docker-entrypoint.sh

# è®¾ç½®é»˜è®¤ç¯å¢ƒå˜é‡
ENV NGINX_HOST=localhost
ENV NGINX_PORT=80
ENV BACKEND_HOST=app
ENV BACKEND_PORT=3000
ENV NGINX_WORKER_PROCESSES=auto

ENTRYPOINT ["/docker-entrypoint.sh"]
CMD ["nginx", "-g", "daemon off;"]
```

#### ğŸ”¸ å¯åŠ¨è„šæœ¬å¤„ç†æ¨¡æ¿

```bash
#!/bin/sh
# docker-entrypoint.sh

# ä½¿ç”¨envsubstæ›¿æ¢æ¨¡æ¿å˜é‡
envsubst '${NGINX_HOST} ${NGINX_PORT} ${BACKEND_HOST} ${BACKEND_PORT}' \
  < /etc/nginx/templates/nginx.conf.template \
  > /etc/nginx/nginx.conf

# éªŒè¯é…ç½®æ–‡ä»¶
nginx -t

# å¯åŠ¨Nginx
exec "$@"
```

### 5.4 ä¸åŒç¯å¢ƒçš„é…ç½®ç®¡ç†


#### ğŸ”¸ å¼€å‘ç¯å¢ƒé…ç½®

```bash
# dev.env
APP_ENV=development
DB_HOST=localhost
DB_PORT=3306
LOG_LEVEL=debug
NGINX_WORKER_PROCESSES=1
SSL_ENABLED=false

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker run -d \
  --name web-dev \
  --env-file dev.env \
  -p 3000:80 \
  my-web-app:dev
```

#### ğŸ”¸ ç”Ÿäº§ç¯å¢ƒé…ç½®

```bash
# prod.env
APP_ENV=production
DB_HOST=prod-mysql.company.com
DB_PORT=3306
LOG_LEVEL=warn
NGINX_WORKER_PROCESSES=auto
SSL_ENABLED=true
SSL_CERT_PATH=/etc/ssl/certs/app.crt
SSL_KEY_PATH=/etc/ssl/private/app.key

# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
docker run -d \
  --name web-prod \
  --env-file prod.env \
  -v ssl-certs:/etc/ssl \
  -p 443:443 \
  my-web-app:latest
```

### 5.5 æ•æ„Ÿä¿¡æ¯ç®¡ç†


#### ğŸ”¸ Docker Secretsï¼ˆSwarmæ¨¡å¼ï¼‰

```bash
# åˆ›å»ºå¯†é’¥
echo "super_secret_password" | docker secret create db_password -

# åœ¨æœåŠ¡ä¸­ä½¿ç”¨å¯†é’¥
docker service create \
  --name web-service \
  --secret db_password \
  --env DB_PASSWORD_FILE=/run/secrets/db_password \
  my-web-app:latest
```

#### ğŸ”¸ å¤–éƒ¨å¯†é’¥ç®¡ç†ç³»ç»Ÿ

```bash
# ä»å¤–éƒ¨ç³»ç»Ÿè·å–é…ç½®
docker run -d \
  --name web-app \
  -e VAULT_ADDR=https://vault.company.com \
  -e VAULT_TOKEN_FILE=/var/secrets/vault-token \
  -v vault-secrets:/var/secrets:ro \
  my-web-app:latest
```

**æ•æ„Ÿä¿¡æ¯ç®¡ç†åŸåˆ™ï¼š**
```
âŒ ä¸å¥½çš„åšæ³•ï¼š
â€¢ åœ¨Dockerfileä¸­å†™æ­»å¯†ç 
â€¢ åœ¨ç¯å¢ƒå˜é‡ä¸­æ˜æ–‡å­˜å‚¨å¯†é’¥
â€¢ åœ¨é•œåƒä¸­åŒ…å«è¯ä¹¦æ–‡ä»¶

âœ… å¥½çš„åšæ³•ï¼š
â€¢ ä½¿ç”¨Docker Secretsæˆ–å¤–éƒ¨å¯†é’¥ç®¡ç†
â€¢ åœ¨è¿è¡Œæ—¶æŒ‚è½½è¯ä¹¦æ–‡ä»¶
â€¢ ä½¿ç”¨ç¯å¢ƒå˜é‡æŒ‡å‘å¯†é’¥æ–‡ä»¶è·¯å¾„
â€¢ å®šæœŸè½®æ¢å¯†é’¥å’Œè¯ä¹¦
```

### 5.6 é…ç½®éªŒè¯ä¸è°ƒè¯•


```bash
# æŸ¥çœ‹å®¹å™¨ç¯å¢ƒå˜é‡
docker exec web-app env

# éªŒè¯ç‰¹å®šå˜é‡
docker exec web-app echo $DB_HOST

# è°ƒè¯•é…ç½®æ–‡ä»¶ç”Ÿæˆ
docker exec web-app cat /etc/nginx/nginx.conf

# å®æ—¶æŸ¥çœ‹é…ç½®å˜åŒ–
docker exec -it web-app sh
# åœ¨å®¹å™¨å†…æ£€æŸ¥é…ç½®
```

**é…ç½®ç®¡ç†æœ€ä½³å®è·µï¼š**
```
ğŸ¯ é…ç½®å±‚æ¬¡åŒ–ï¼š
ç³»ç»Ÿçº§ï¼šæ“ä½œç³»ç»Ÿã€è¿è¡Œæ—¶é…ç½®
åº”ç”¨çº§ï¼šä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“è¿æ¥
ç¯å¢ƒçº§ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§å·®å¼‚é…ç½®

ğŸ¯ é…ç½®éªŒè¯ï¼š
â€¢ å¯åŠ¨æ—¶éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
â€¢ é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥
â€¢ è¿æ¥æµ‹è¯•ï¼ˆæ•°æ®åº“ã€å¤–éƒ¨æœåŠ¡ï¼‰
â€¢ æä¾›é…ç½®æ ·ä¾‹å’Œæ–‡æ¡£

ğŸ¯ é…ç½®å®‰å…¨ï¼š
â€¢ æ•æ„Ÿé…ç½®ç‹¬ç«‹ç®¡ç†
â€¢ ä½¿ç”¨ä¸“ç”¨çš„é…ç½®ç®¡ç†å·¥å…·
â€¢ å®šæœŸå®¡è®¡é…ç½®æƒé™
â€¢ è®°å½•é…ç½®å˜æ›´å†å²
```

---

## 6. ğŸ¼ å¤šå®¹å™¨ç¼–æ’é…ç½®


### 6.1 å®¹å™¨ç¼–æ’åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å®¹å™¨ç¼–æ’ï¼Ÿ**
> å®¹å™¨ç¼–æ’å°±åƒ"æŒ‡æŒ¥äº¤å“ä¹å›¢"ï¼Œè®©å¤šä¸ªå®¹å™¨ï¼ˆä¹æ‰‹ï¼‰æŒ‰ç…§é¢„å®šçš„é…ç½®ï¼ˆä¹è°±ï¼‰åè°ƒå·¥ä½œï¼Œå®ç°å¤æ‚åº”ç”¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç®¡ç†ã€‚

```
å•å®¹å™¨ vs å¤šå®¹å™¨åº”ç”¨ï¼š

å•å®¹å™¨åº”ç”¨ï¼š
[Webåº”ç”¨] - ç®€å•ä½†åŠŸèƒ½å—é™

å¤šå®¹å™¨åº”ç”¨æ¶æ„ï¼š
[è´Ÿè½½å‡è¡¡å™¨] â† ç”¨æˆ·è¯·æ±‚
      â†“
[WebæœåŠ¡å™¨1] [WebæœåŠ¡å™¨2] â† å¤„ç†è¯·æ±‚
      â†“           â†“
[åº”ç”¨æœåŠ¡å™¨1] [åº”ç”¨æœåŠ¡å™¨2] â† ä¸šåŠ¡é€»è¾‘  
      â†“           â†“
[æ•°æ®åº“ä¸»] [æ•°æ®åº“ä»] â† æ•°æ®å­˜å‚¨
      â†“
[ç¼“å­˜æœåŠ¡] â† æ€§èƒ½ä¼˜åŒ–
```

### 6.2 Docker ComposeåŸºç¡€ä½¿ç”¨


#### ğŸ”¸ åŸºç¡€Webåº”ç”¨ç¼–æ’

```yaml
# docker-compose.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    container_name: web-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./html:/usr/share/nginx/html:ro
      - nginx-logs:/var/log/nginx
    depends_on:
      - app
    restart: unless-stopped

  app:
    build: ./app
    container_name: web-app
    environment:
      - NODE_ENV=production
      - DB_HOST=database
      - DB_PORT=3306
    volumes:
      - app-data:/app/data
    depends_on:
      - database
    restart: unless-stopped

  database:
    image: mysql:8.0
    container_name: web-db
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_DATABASE=webapp
      - MYSQL_USER=appuser
      - MYSQL_PASSWORD=apppassword
    volumes:
      - db-data:/var/lib/mysql
    restart: unless-stopped

volumes:
  nginx-logs:
  app-data:
  db-data:
```

#### ğŸ”¸ å¯åŠ¨å’Œç®¡ç†ç¼–æ’æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs nginx
docker-compose logs -f app  # å®æ—¶æ—¥å¿—

# æ‰©å±•æœåŠ¡å®ä¾‹
docker-compose up -d --scale app=3

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
docker-compose down -v
```

### 6.3 é«˜å¯ç”¨WebæœåŠ¡ç¼–æ’


#### ğŸ”¸ è´Ÿè½½å‡è¡¡ + å¤šå®ä¾‹é…ç½®

```yaml
# ha-web.yml - é«˜å¯ç”¨WebæœåŠ¡
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx-lb.conf:/etc/nginx/nginx.conf:ro
      - ssl-certs:/etc/ssl:ro
    depends_on:
      - app
    deploy:
      replicas: 2
      restart_policy:
        condition: any
        delay: 5s

  app:
    build: ./app
    environment:
      - NODE_ENV=production
      - DB_HOST=database
      - REDIS_HOST=cache
    volumes:
      - app-logs:/app/logs
    depends_on:
      - database
      - cache
    deploy:
      replicas: 3
      restart_policy:
        condition: any

  database:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD_FILE=/run/secrets/db_root_password
      - MYSQL_DATABASE=webapp
    volumes:
      - db-data:/var/lib/mysql
      - ./mysql-config:/etc/mysql/conf.d:ro
    secrets:
      - db_root_password
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == manager

  cache:
    image: redis:alpine
    volumes:
      - redis-data:/data
    deploy:
      replicas: 1

volumes:
  db-data:
  redis-data:
  app-logs:
  ssl-certs:

secrets:
  db_root_password:
    file: ./secrets/db_root_password.txt
```

#### ğŸ”¸ Nginxè´Ÿè½½å‡è¡¡é…ç½®

```nginx
# nginx-lb.conf
upstream app_servers {
    server ha-web_app_1:3000;
    server ha-web_app_2:3000;
    server ha-web_app_3:3000;
    
    # å¥åº·æ£€æŸ¥é…ç½®
    keepalive 32;
}

server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://app_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # è´Ÿè½½å‡è¡¡é…ç½®
        proxy_next_upstream error timeout http_500;
        proxy_connect_timeout 5s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
    }
}
```

### 6.4 å¾®æœåŠ¡æ¶æ„ç¼–æ’


#### ğŸ”¸ å¾®æœåŠ¡Docker Composeé…ç½®

```yaml
# microservices.yml
version: '3.8'

services:
  # APIç½‘å…³
  gateway:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./gateway.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - user-service
      - order-service
      - product-service

  # ç”¨æˆ·æœåŠ¡
  user-service:
    build: ./services/user
    environment:
      - SERVICE_NAME=user-service
      - DB_HOST=user-db
    depends_on:
      - user-db
    deploy:
      replicas: 2

  # è®¢å•æœåŠ¡
  order-service:
    build: ./services/order
    environment:
      - SERVICE_NAME=order-service
      - DB_HOST=order-db
      - USER_SERVICE_URL=http://user-service:3000
    depends_on:
      - order-db
    deploy:
      replicas: 2

  # äº§å“æœåŠ¡
  product-service:
    build: ./services/product
    environment:
      - SERVICE_NAME=product-service
      - DB_HOST=product-db
    depends_on:
      - product-db

  # æ•°æ®åº“æœåŠ¡
  user-db:
    image: postgres:13
    environment:
      - POSTGRES_DB=users
      - POSTGRES_USER=user_service
      - POSTGRES_PASSWORD=password
    volumes:
      - user-db-data:/var/lib/postgresql/data

  order-db:
    image: postgres:13
    environment:
      - POSTGRES_DB=orders
      - POSTGRES_USER=order_service
      - POSTGRES_PASSWORD=password
    volumes:
      - order-db-data:/var/lib/postgresql/data

  product-db:
    image: postgres:13
    environment:
      - POSTGRES_DB=products
      - POSTGRES_USER=product_service
      - POSTGRES_PASSWORD=password
    volumes:
      - product-db-data:/var/lib/postgresql/data

  # ç›‘æ§æœåŠ¡
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro

volumes:
  user-db-data:
  order-db-data:
  product-db-data:
```

### 6.5 å¼€å‘ç¯å¢ƒç¼–æ’é…ç½®


#### ğŸ”¸ å¼€å‘å‹å¥½çš„ç¼–æ’é…ç½®

```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx-dev.conf:/etc/nginx/nginx.conf:ro
      - ./src:/usr/share/nginx/html  # æºç çƒ­é‡è½½
    depends_on:
      - app

  app:
    build:
      context: ./app
      dockerfile: Dockerfile.dev
    environment:
      - NODE_ENV=development
      - DEBUG=true
      - DB_HOST=database
    volumes:
      - ./app/src:/app/src  # ä»£ç çƒ­é‡è½½
      - ./app/package.json:/app/package.json
      - node_modules:/app/node_modules
    ports:
      - "3000:3000"  # è°ƒè¯•ç«¯å£
    depends_on:
      - database

  database:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=dev123
      - MYSQL_DATABASE=webapp_dev
    ports:
      - "3306:3306"  # ç›´æ¥è®¿é—®æ•°æ®åº“
    volumes:
      - db-dev-data:/var/lib/mysql

volumes:
  node_modules:
  db-dev-data:
```

**å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒå·®å¼‚ï¼š**
```
å¼€å‘ç¯å¢ƒç‰¹ç‚¹ï¼š
â€¢ ä»£ç çƒ­é‡è½½ï¼ˆvolumeæŒ‚è½½æºç ï¼‰
â€¢ æš´éœ²æ›´å¤šç«¯å£ä¾¿äºè°ƒè¯•
â€¢ ä½¿ç”¨ç®€å•å¯†ç 
â€¢ è¯¦ç»†æ—¥å¿—è¾“å‡º
â€¢ å¿«é€Ÿé‡å¯

ç”Ÿäº§ç¯å¢ƒç‰¹ç‚¹ï¼š
â€¢ ä½¿ç”¨æ„å»ºå¥½çš„é•œåƒ
â€¢ æœ€å°åŒ–ç«¯å£æš´éœ²
â€¢ ä½¿ç”¨å®‰å…¨å¯†é’¥ç®¡ç†
â€¢ ä¼˜åŒ–çš„æ—¥å¿—çº§åˆ«
â€¢ é«˜å¯ç”¨å’Œå®¹é”™é…ç½®
```

### 6.6 ç¼–æ’é…ç½®æœ€ä½³å®è·µ


```yaml
# ç”Ÿäº§çº§ç¼–æ’é…ç½®è¦ç‚¹
version: '3.8'

services:
  app:
    image: myapp:${VERSION:-latest}
    environment:
      - NODE_ENV=${ENV:-production}
    volumes:
      - app-data:/app/data
    deploy:
      replicas: 3
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 3
      update_config:
        parallelism: 1
        delay: 10s
        failure_action: rollback
      resources:
        limits:
          cpus: '0.50'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
```

**ç¼–æ’é…ç½®å®‰å…¨å»ºè®®ï¼š**
```
ğŸ”’ å®‰å…¨é…ç½®è¦ç‚¹ï¼š
â€¢ ä½¿ç”¨érootç”¨æˆ·è¿è¡Œå®¹å™¨
â€¢ é™åˆ¶å®¹å™¨èµ„æºä½¿ç”¨
â€¢ ä½¿ç”¨å®‰å…¨çš„é•œåƒåŸºç¡€
â€¢ å®šæœŸæ›´æ–°é•œåƒç‰ˆæœ¬
â€¢ é…ç½®é€‚å½“çš„ç½‘ç»œéš”ç¦»

ğŸ”’ ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•ï¼š
â–¡ æ‰€æœ‰å¯†ç ä½¿ç”¨å¯†é’¥ç®¡ç†
â–¡ é…ç½®å¥åº·æ£€æŸ¥
â–¡ è®¾ç½®èµ„æºé™åˆ¶
â–¡ é…ç½®é‡å¯ç­–ç•¥
â–¡ å®ç°æ»šåŠ¨æ›´æ–°
â–¡ ç›‘æ§å’Œæ—¥å¿—æ”¶é›†
```

---

## 7. ğŸ¥ å®¹å™¨å¥åº·æ£€æŸ¥


### 7.1 å¥åº·æ£€æŸ¥åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å®¹å™¨å¥åº·æ£€æŸ¥ï¼Ÿ**
> å¥åº·æ£€æŸ¥å°±åƒ"åŒ»ç”Ÿå®šæœŸä½“æ£€"ï¼Œå®šæœŸæ£€æŸ¥å®¹å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚å³ä½¿å®¹å™¨åœ¨è¿è¡Œï¼Œä¹Ÿè¦ç¡®è®¤é‡Œé¢çš„åº”ç”¨çœŸçš„èƒ½å“åº”è¯·æ±‚ï¼Œè€Œä¸åªæ˜¯"çœ‹èµ·æ¥æ´»ç€"ã€‚

```
å®¹å™¨çŠ¶æ€ vs åº”ç”¨å¥åº·çŠ¶æ€ï¼š

å®¹å™¨çŠ¶æ€ï¼š
running â”€â”€ å®¹å™¨è¿›ç¨‹åœ¨è¿è¡Œ
exited  â”€â”€ å®¹å™¨è¿›ç¨‹å·²é€€å‡º

åº”ç”¨å¥åº·çŠ¶æ€ï¼š
healthy   â”€â”€ åº”ç”¨æ­£å¸¸å“åº”æœåŠ¡
unhealthy â”€â”€ åº”ç”¨æ— æ³•æ­£å¸¸æœåŠ¡
starting  â”€â”€ åº”ç”¨å¯åŠ¨ä¸­

é—®é¢˜åœºæ™¯ï¼š
å®¹å™¨çŠ¶æ€=runningï¼Œä½†åº”ç”¨å¥åº·=unhealthy
ä¾‹å¦‚ï¼šè¿›ç¨‹å­˜åœ¨ä½†æ•°æ®åº“è¿æ¥æ–­å¼€
```

### 7.2 DockeråŸç”Ÿå¥åº·æ£€æŸ¥


#### ğŸ”¸ åŸºç¡€å¥åº·æ£€æŸ¥é…ç½®

```dockerfile
# Dockerfileä¸­å®šä¹‰å¥åº·æ£€æŸ¥
FROM nginx:alpine

# åŸºç¡€HTTPå¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost/ || exit 1

# æˆ–è€…ä½¿ç”¨wgetï¼ˆæ›´è½»é‡ï¼‰
HEALTHCHECK --interval=30s --timeout=3s --retries=3 \
  CMD wget --quiet --tries=1 --spider http://localhost/ || exit 1
```

**å¥åº·æ£€æŸ¥å‚æ•°è¯´æ˜ï¼š**
```
--interval=30s    â”€â”€ æ£€æŸ¥é—´éš”ï¼ˆå¤šä¹…æ£€æŸ¥ä¸€æ¬¡ï¼‰
--timeout=3s      â”€â”€ è¶…æ—¶æ—¶é—´ï¼ˆæ£€æŸ¥å‘½ä»¤æœ€å¤§è¿è¡Œæ—¶é—´ï¼‰
--start-period=5s â”€â”€ å¯åŠ¨å®½é™æœŸï¼ˆå®¹å™¨å¯åŠ¨åå¤šä¹…å¼€å§‹æ£€æŸ¥ï¼‰
--retries=3       â”€â”€ é‡è¯•æ¬¡æ•°ï¼ˆå¤±è´¥å¤šå°‘æ¬¡è®¤ä¸ºä¸å¥åº·ï¼‰

æ£€æŸ¥ç»“æœï¼š
exit 0 â”€â”€ å¥åº·
exit 1 â”€â”€ ä¸å¥åº·
exit 2 â”€â”€ ä¿ç•™å€¼ï¼Œç­‰åŒäºä¸å¥åº·
```

#### ğŸ”¸ è¿è¡Œæ—¶å¥åº·æ£€æŸ¥

```bash
# è¿è¡Œæ—¶æ·»åŠ å¥åº·æ£€æŸ¥
docker run -d \
  --name nginx-health \
  --health-cmd="curl -f http://localhost/ || exit 1" \
  --health-interval=30s \
  --health-timeout=3s \
  --health-retries=3 \
  -p 80:80 \
  nginx:alpine

# æŸ¥çœ‹å¥åº·çŠ¶æ€
docker ps
# STATUS: Up 5 minutes (healthy)

# è¯¦ç»†å¥åº·æ£€æŸ¥ä¿¡æ¯
docker inspect nginx-health | grep -A 10 Health
```

### 7.3 WebæœåŠ¡å¥åº·æ£€æŸ¥å®è·µ


#### ğŸ”¸ Nginxå¥åº·æ£€æŸ¥é…ç½®

```nginx
# nginx.conf - æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
server {
    listen 80;
    server_name localhost;
    
    # ä¸»è¦æœåŠ¡
    location / {
        root /usr/share/nginx/html;
        index index.html;
    }
    
    # å¥åº·æ£€æŸ¥ç«¯ç‚¹
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
    
    # è¯¦ç»†çŠ¶æ€æ£€æŸ¥
    location /status {
        stub_status on;
        access_log off;
        allow 127.0.0.1;
        deny all;
    }
}
```

```dockerfile
# Nginxå¥åº·æ£€æŸ¥Dockerfile
FROM nginx:alpine

COPY nginx.conf /etc/nginx/nginx.conf
COPY html/ /usr/share/nginx/html/

# å®‰è£…curlç”¨äºå¥åº·æ£€æŸ¥
RUN apk add --no-cache curl

# å¥åº·æ£€æŸ¥é…ç½®
HEALTHCHECK --interval=30s --timeout=3s --start-period=10s --retries=3 \
  CMD curl -f http://localhost/health || exit 1

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

#### ğŸ”¸ åº”ç”¨å±‚å¥åº·æ£€æŸ¥

```javascript
// Node.jsåº”ç”¨å¥åº·æ£€æŸ¥ç«¯ç‚¹
const express = require('express');
const app = express();

// å¥åº·æ£€æŸ¥ç«¯ç‚¹
app.get('/health', async (req, res) => {
  try {
    // æ£€æŸ¥æ•°æ®åº“è¿æ¥
    await database.ping();
    
    // æ£€æŸ¥å…³é”®æœåŠ¡
    const redisStatus = await redis.ping();
    
    // æ£€æŸ¥å¤–éƒ¨ä¾èµ–
    const apiStatus = await checkExternalAPI();
    
    if (redisStatus && apiStatus) {
      res.status(200).json({
        status: 'healthy',
        timestamp: new Date().toISOString(),
        uptime: process.uptime()
      });
    } else {
      throw new Error('Dependency check failed');
    }
  } catch (error) {
    res.status(503).json({
      status: 'unhealthy',
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

// ç®€å•çš„å­˜æ´»æ£€æŸ¥
app.get('/ping', (req, res) => {
  res.status(200).send('pong');
});
```

### 7.4 Docker Composeå¥åº·æ£€æŸ¥


#### ğŸ”¸ ç»„åˆæœåŠ¡å¥åº·æ£€æŸ¥

```yaml
# docker-compose.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    depends_on:
      app:
        condition: service_healthy

  app:
    build: ./app
    environment:
      - NODE_ENV=production
      - DB_HOST=database
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 20s
      timeout: 5s
      retries: 5
      start_period: 60s
    depends_on:
      database:
        condition: service_healthy

  database:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_DATABASE=webapp
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    volumes:
      - db-data:/var/lib/mysql

volumes:
  db-data:
```

### 7.5 é«˜çº§å¥åº·æ£€æŸ¥ç­–ç•¥


#### ğŸ”¸ å¤šå±‚æ¬¡å¥åº·æ£€æŸ¥

```bash
#!/bin/bash
# health-check.sh - ç»¼åˆå¥åº·æ£€æŸ¥è„šæœ¬

# 1. åŸºç¡€è¿é€šæ€§æ£€æŸ¥
curl -f http://localhost:3000/ping > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "Basic connectivity failed"
    exit 1
fi

# 2. åº”ç”¨åŠŸèƒ½æ£€æŸ¥
response=$(curl -s http://localhost:3000/health)
if [ $? -ne 0 ]; then
    echo "Health endpoint failed"
    exit 1
fi

# 3. æ£€æŸ¥å“åº”å†…å®¹
echo $response | grep -q "healthy"
if [ $? -ne 0 ]; then
    echo "Health status is not healthy"
    exit 1
fi

# 4. æ£€æŸ¥å…³é”®è¿›ç¨‹
pgrep node > /dev/null
if [ $? -ne 0 ]; then
    echo "Node process not found"
    exit 1
fi

# 5. æ£€æŸ¥ç£ç›˜ç©ºé—´
disk_usage=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $disk_usage -gt 90 ]; then
    echo "Disk usage too high: $disk_usage%"
    exit 1
fi

echo "All health checks passed"
exit 0
```

#### ğŸ”¸ åŸºäºæŒ‡æ ‡çš„å¥åº·æ£€æŸ¥

```yaml
# é«˜çº§å¥åº·æ£€æŸ¥é…ç½®
version: '3.8'

services:
  app:
    build: ./app
    healthcheck:
      test: ["CMD", "/app/health-check.sh"]
      interval: 15s
      timeout: 10s
      retries: 3
      start_period: 45s
    deploy:
      replicas: 3
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
```

### 7.6 å¥åº·æ£€æŸ¥ç›‘æ§ä¸å‘Šè­¦


#### ğŸ”¸ å¥åº·çŠ¶æ€ç›‘æ§

```bash
# ç›‘æ§å®¹å™¨å¥åº·çŠ¶æ€
docker ps --format "table {{.Names}}\t{{.Status}}"

# è·å–è¯¦ç»†å¥åº·ä¿¡æ¯
docker inspect --format='{{.State.Health.Status}}' container_name

# æŸ¥çœ‹å¥åº·æ£€æŸ¥å†å²
docker inspect --format='{{range .State.Health.Log}}{{.Start}}: {{.Output}}{{end}}' container_name
```

#### ğŸ”¸ è‡ªåŠ¨åŒ–å¥åº·ç›‘æ§è„šæœ¬

```bash
#!/bin/bash
# monitor-health.sh

containers=("nginx" "app" "database")

for container in "${containers[@]}"; do
    health_status=$(docker inspect --format='{{.State.Health.Status}}' $container 2>/dev/null)
    
    if [ "$health_status" = "unhealthy" ]; then
        echo "ALERT: Container $container is unhealthy"
        # å‘é€å‘Šè­¦é€šçŸ¥
        curl -X POST https://hooks.slack.com/webhook \
             -d "{'text': 'Container $container is unhealthy'}"
        
        # å¯é€‰ï¼šè‡ªåŠ¨é‡å¯ä¸å¥åº·çš„å®¹å™¨
        # docker restart $container
    elif [ "$health_status" = "healthy" ]; then
        echo "OK: Container $container is healthy"
    else
        echo "UNKNOWN: Container $container status: $health_status"
    fi
done
```

**å¥åº·æ£€æŸ¥æœ€ä½³å®è·µï¼š**
```
ğŸ¯ æ£€æŸ¥ç­–ç•¥è®¾è®¡ï¼š
â€¢ è½»é‡çº§æ£€æŸ¥ï¼šé¿å…æ£€æŸ¥è¿‡ç¨‹æ¶ˆè€—å¤ªå¤šèµ„æº
â€¢ å¿«é€Ÿå¤±è´¥ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
â€¢ æ¸è¿›å¼æ£€æŸ¥ï¼šä»ç®€å•åˆ°å¤æ‚çš„æ£€æŸ¥å±‚æ¬¡
â€¢ æœ‰æ„ä¹‰çš„æ£€æŸ¥ï¼šæ£€æŸ¥çœŸæ­£å½±å“æœåŠ¡çš„æŒ‡æ ‡

ğŸ¯ é…ç½®ä¼˜åŒ–ï¼š
â€¢ å¯åŠ¨å®½é™æœŸè¦å……è¶³ï¼ˆè€ƒè™‘åº”ç”¨å¯åŠ¨æ—¶é—´ï¼‰
â€¢ æ£€æŸ¥é—´éš”å¹³è¡¡åŠæ—¶æ€§å’Œèµ„æºæ¶ˆè€—
â€¢ é‡è¯•æ¬¡æ•°é¿å…å¶å‘æ€§å¤±è´¥è¯¯åˆ¤
â€¢ ç»“åˆä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´æ£€æŸ¥å†…å®¹

ğŸ¯ æ•…éšœå¤„ç†ï¼š
â€¢ è®°å½•è¯¦ç»†çš„å¥åº·æ£€æŸ¥æ—¥å¿—
â€¢ é…ç½®è‡ªåŠ¨é‡å¯ç­–ç•¥
â€¢ è®¾ç½®ç›‘æ§å‘Šè­¦æœºåˆ¶
â€¢ å®šæœŸåˆ†æå¥åº·æ£€æŸ¥æ•°æ®
```

---

## 8. ğŸ”„ æ»šåŠ¨æ›´æ–°éƒ¨ç½²


### 8.1 æ»šåŠ¨æ›´æ–°åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ»šåŠ¨æ›´æ–°ï¼Ÿ**
> æ»šåŠ¨æ›´æ–°å°±åƒ"æ¢è½®èƒä¸åœè½¦"ï¼Œåœ¨ä¸åœæ­¢æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œé€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬å®¹å™¨ä¸ºæ–°ç‰ˆæœ¬ï¼Œç¡®ä¿ç”¨æˆ·æ— æ„ŸçŸ¥çš„å¹³æ»‘å‡çº§ã€‚

```
ä¼ ç»Ÿæ›´æ–° vs æ»šåŠ¨æ›´æ–°ï¼š

ä¼ ç»Ÿæ›´æ–°ï¼ˆåœæœºæ›´æ–°ï¼‰ï¼š
åœæ­¢æ‰€æœ‰æœåŠ¡ â†’ éƒ¨ç½²æ–°ç‰ˆæœ¬ â†’ å¯åŠ¨æœåŠ¡
é—®é¢˜ï¼šæœåŠ¡ä¸­æ–­ï¼Œç”¨æˆ·ä½“éªŒå·®

æ»šåŠ¨æ›´æ–°ï¼š
æ—§ç‰ˆæœ¬: [V1] [V1] [V1]
ç¬¬ä¸€æ­¥: [V2] [V1] [V1] â† å¯åŠ¨æ–°å®ä¾‹
ç¬¬äºŒæ­¥: [V2] [V2] [V1] â† é€æ­¥æ›¿æ¢
ç¬¬ä¸‰æ­¥: [V2] [V2] [V2] â† å®Œæˆæ›´æ–°
ä¼˜åŠ¿ï¼šé›¶åœæœºï¼Œæ¸è¿›å¼ï¼Œå¯å›æ»š
```

### 8.2 Docker Swarmæ»šåŠ¨æ›´æ–°


#### ğŸ”¸ Swarmé›†ç¾¤æœåŠ¡æ›´æ–°

```bash
# åˆå§‹åŒ–Swarmé›†ç¾¤
docker swarm init

# åˆ›å»ºæœåŠ¡
docker service create \
  --name web-service \
  --replicas 3 \
  --publish 80:80 \
  --update-delay 10s \
  --update-parallelism 1 \
  --update-failure-action rollback \
  nginx:1.20

# æ‰§è¡Œæ»šåŠ¨æ›´æ–°
docker service update \
  --image nginx:1.21 \
  web-service

# ç›‘æ§æ›´æ–°è¿›åº¦
docker service ps web-service
```

**æ›´æ–°è¿‡ç¨‹è¯¦è§£ï¼š**
```
æ›´æ–°å‚æ•°è¯´æ˜ï¼š
--update-delay 10s        â”€â”€ æ›´æ–°é—´éš”ï¼ˆæ¯ä¸ªå®¹å™¨æ›´æ–°é—´éš”ï¼‰
--update-parallelism 1    â”€â”€ å¹¶è¡Œåº¦ï¼ˆåŒæ—¶æ›´æ–°å‡ ä¸ªå®¹å™¨ï¼‰
--update-failure-action   â”€â”€ å¤±è´¥æ—¶åŠ¨ä½œï¼ˆpause/continue/rollbackï¼‰

æ›´æ–°æµç¨‹ï¼š
1. åœæ­¢ç¬¬1ä¸ªæ—§å®¹å™¨
2. å¯åŠ¨ç¬¬1ä¸ªæ–°å®¹å™¨
3. ç­‰å¾…å¥åº·æ£€æŸ¥é€šè¿‡
4. ç­‰å¾…10ç§’ï¼ˆupdate-delayï¼‰
5. é‡å¤æ­¥éª¤1-4ç›´åˆ°æ‰€æœ‰å®¹å™¨æ›´æ–°å®Œæˆ
```

#### ğŸ”¸ Docker Composeæ»šåŠ¨æ›´æ–°

```bash
# æ›´æ–°é•œåƒç‰ˆæœ¬
# ä¿®æ”¹docker-compose.ymlä¸­çš„é•œåƒç‰ˆæœ¬
# image: nginx:1.20 â†’ image: nginx:1.21

# æ‰§è¡Œæ»šåŠ¨æ›´æ–°
docker-compose up -d --no-deps --scale app=6 app  # å…ˆæ‰©å®¹
docker-compose up -d --no-deps --scale app=3 app  # å†ç¼©å®¹

# æˆ–ä½¿ç”¨æ›´ç®€å•çš„æ–¹å¼
docker-compose pull  # æ‹‰å–æ–°é•œåƒ
docker-compose up -d  # é‡æ–°åˆ›å»ºå®¹å™¨
```

### 8.3 é›¶åœæœºéƒ¨ç½²ç­–ç•¥


#### ğŸ”¸ è“ç»¿éƒ¨ç½²å®ç°

```yaml
# blue-green-deployment.yml
version: '3.8'

services:
  # è´Ÿè½½å‡è¡¡å™¨
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx-bg.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - app-blue

  # è“è‰²ç¯å¢ƒï¼ˆå½“å‰ç”Ÿäº§ï¼‰
  app-blue:
    image: myapp:v1.0
    environment:
      - APP_VERSION=v1.0
      - ENV_COLOR=blue
    deploy:
      replicas: 3

  # ç»¿è‰²ç¯å¢ƒï¼ˆæ–°ç‰ˆæœ¬ï¼‰
  app-green:
    image: myapp:v2.0
    environment:
      - APP_VERSION=v2.0
      - ENV_COLOR=green
    deploy:
      replicas: 3
    profiles:
      - green  # é»˜è®¤ä¸å¯åŠ¨
```

```nginx
# nginx-bg.conf - è“ç»¿åˆ‡æ¢é…ç½®
upstream app_blue {
    server blue-green-deployment_app-blue_1:3000;
    server blue-green-deployment_app-blue_2:3000;
    server blue-green-deployment_app-blue_3:3000;
}

upstream app_green {
    server blue-green-deployment_app-green_1:3000;
    server blue-green-deployment_app-green_2:3000;
    server blue-green-deployment_app-green_3:3000;
}

server {
    listen 80;
    
    location / {
        # åˆ‡æ¢è¿™é‡Œå®ç°è“ç»¿éƒ¨ç½²
        proxy_pass http://app_blue;  # å½“å‰æŒ‡å‘è“è‰²
        # proxy_pass http://app_green;  # åˆ‡æ¢åˆ°ç»¿è‰²
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

#### ğŸ”¸ è“ç»¿éƒ¨ç½²æ“ä½œæµç¨‹

```bash
# 1. å¯åŠ¨ç»¿è‰²ç¯å¢ƒ
docker-compose --profile green up -d app-green

# 2. éªŒè¯ç»¿è‰²ç¯å¢ƒ
curl -H "Host: green.example.com" http://localhost/health

# 3. åˆ‡æ¢æµé‡åˆ°ç»¿è‰²ç¯å¢ƒ
# ä¿®æ”¹nginxé…ç½®ï¼šproxy_pass http://app_green;
docker-compose exec nginx nginx -s reload

# 4. éªŒè¯ç”Ÿäº§æµé‡
curl http://localhost/

# 5. å…³é—­è“è‰²ç¯å¢ƒ
docker-compose stop app-blue

# 6. å¦‚éœ€å›æ»šï¼Œå†æ¬¡åˆ‡æ¢nginxé…ç½®å³å¯
```

### 8.4 é‡‘ä¸é›€éƒ¨ç½²


#### ğŸ”¸ é‡‘ä¸é›€éƒ¨ç½²é…ç½®

```yaml
# canary-deployment.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx-canary.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - app-stable
      - app-canary

  # ç¨³å®šç‰ˆæœ¬ï¼ˆ90%æµé‡ï¼‰
  app-stable:
    image: myapp:v1.0
    environment:
      - APP_VERSION=v1.0
    deploy:
      replicas: 9  # 90%

  # é‡‘ä¸é›€ç‰ˆæœ¬ï¼ˆ10%æµé‡ï¼‰
  app-canary:
    image: myapp:v2.0
    environment:
      - APP_VERSION=v2.0
    deploy:
      replicas: 1  # 10%
```

```nginx
# nginx-canary.conf - é‡‘ä¸é›€è·¯ç”±é…ç½®
upstream app_stable {
    server canary-deployment_app-stable_1:3000 weight=9;
    server canary-deployment_app-stable_2:3000 weight=9;
    server canary-deployment_app-stable_3:3000 weight=9;
}

upstream app_canary {
    server canary-deployment_app-canary_1:3000 weight=1;
}

# æŒ‰æƒé‡åˆ†å‘æµé‡
upstream app_mixed {
    server canary-deployment_app-stable_1:3000 weight=9;
    server canary-deployment_app-stable_2:3000 weight=9;
    server canary-deployment_app-stable_3:3000 weight=9;
    server canary-deployment_app-canary_1:3000 weight=1;
}

server {
    listen 80;
    
    location / {
        proxy_pass http://app_mixed;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # æ·»åŠ ç‰ˆæœ¬æ ‡è¯†å¤´
        add_header X-Upstream-Version $upstream_addr;
    }
    
    # ç‰¹å®šç”¨æˆ·ç¾¤ä½“æµ‹è¯•
    location /beta {
        proxy_pass http://app_canary;
        proxy_set_header Host $host;
    }
}
```

#### ğŸ”¸ æ¸è¿›å¼é‡‘ä¸é›€éƒ¨ç½²

```bash
# ç¬¬ä¸€é˜¶æ®µï¼š5%æµé‡åˆ°é‡‘ä¸é›€
docker-compose up -d --scale app-stable=19 --scale app-canary=1

# ç›‘æ§å…³é”®æŒ‡æ ‡
watch 'curl -s http://localhost/metrics | grep error_rate'

# ç¬¬äºŒé˜¶æ®µï¼š20%æµé‡åˆ°é‡‘ä¸é›€
docker-compose up -d --scale app-stable=8 --scale app-canary=2

# ç¬¬ä¸‰é˜¶æ®µï¼š50%æµé‡åˆ°é‡‘ä¸é›€  
docker-compose up -d --scale app-stable=5 --scale app-canary=5

# æœ€ç»ˆé˜¶æ®µï¼š100%åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬
docker-compose up -d --scale app-stable=0 --scale app-canary=10
```

### 8.5 è‡ªåŠ¨åŒ–æ»šåŠ¨æ›´æ–°


#### ğŸ”¸ åŸºäºå¥åº·æ£€æŸ¥çš„è‡ªåŠ¨æ›´æ–°

```yaml
# auto-rolling-update.yml
version: '3.8'

services:
  app:
    image: myapp:${VERSION:-latest}
    environment:
      - APP_VERSION=${VERSION:-latest}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s
    deploy:
      replicas: 3
      update_config:
        parallelism: 1          # ä¸€æ¬¡æ›´æ–°ä¸€ä¸ªå®¹å™¨
        delay: 30s              # æ›´æ–°é—´éš”
        failure_action: rollback # å¤±è´¥æ—¶å›æ»š
        monitor: 60s            # ç›‘æ§æœŸ
        max_failure_ratio: 0.3  # æœ€å¤§å¤±è´¥ç‡
        order: start-first      # å¯åŠ¨ç­–ç•¥
      rollback_config:
        parallelism: 1
        delay: 10s
        failure_action: pause
        monitor: 30s
        order: stop-first
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 3
        window: 120s
```

#### ğŸ”¸ CI/CDé›†æˆçš„è‡ªåŠ¨åŒ–éƒ¨ç½²

```bash
#!/bin/bash
# deploy.sh - è‡ªåŠ¨åŒ–æ»šåŠ¨æ›´æ–°è„šæœ¬

VERSION=$1
if [ -z "$VERSION" ]; then
    echo "Usage: $0 <version>"
    exit 1
fi

echo "ğŸš€ Starting rolling update to version $VERSION"

# 1. æ‹‰å–æ–°é•œåƒ
echo "ğŸ“¦ Pulling new image..."
docker pull myapp:$VERSION

# 2. éªŒè¯é•œåƒ
echo "ğŸ” Validating image..."
docker run --rm myapp:$VERSION /app/validate.sh
if [ $? -ne 0 ]; then
    echo "âŒ Image validation failed"
    exit 1
fi

# 3. å¼€å§‹æ»šåŠ¨æ›´æ–°
echo "ğŸ”„ Starting rolling update..."
export VERSION=$VERSION
docker-compose up -d

# 4. ç›‘æ§éƒ¨ç½²è¿›åº¦
echo "ğŸ‘€ Monitoring deployment..."
for i in {1..30}; do
    healthy_count=$(docker-compose ps app | grep "healthy" | wc -l)
    total_count=$(docker-compose ps app | grep "Up" | wc -l)
    
    echo "Progress: $healthy_count/$total_count containers healthy"
    
    if [ $healthy_count -eq 3 ]; then
        echo "âœ… Deployment successful!"
        break
    fi
    
    if [ $i -eq 30 ]; then
        echo "âŒ Deployment timeout"
        echo "ğŸ”™ Rolling back..."
        docker-compose rollback
        exit 1
    fi
    
    sleep 10
done

# 5. éªŒè¯æœåŠ¡
echo "ğŸ§ª Running smoke tests..."
curl -f http://localhost/health > /dev/null
if [ $? -eq 0 ]; then
    echo "âœ… Smoke tests passed"
else
    echo "âŒ Smoke tests failed"
    exit 1
fi

echo "ğŸ‰ Rolling update completed successfully!"
```

### 8.6 å›æ»šç­–ç•¥


#### ğŸ”¸ å¿«é€Ÿå›æ»šæ“ä½œ

```bash
# Docker Swarmå›æ»š
docker service rollback web-service

# Docker Composeå›æ»šï¼ˆä½¿ç”¨ä¹‹å‰çš„é•œåƒï¼‰
export VERSION=v1.0  # å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬
docker-compose up -d

# æ‰‹åŠ¨å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
docker service update --image myapp:v1.0 web-service
```

#### ğŸ”¸ è‡ªåŠ¨å›æ»šæ¡ä»¶

```yaml
# è‡ªåŠ¨å›æ»šé…ç½®
services:
  app:
    deploy:
      update_config:
        failure_action: rollback
        monitor: 60s
        max_failure_ratio: 0.3
      rollback_config:
        parallelism: 2
        delay: 5s
        failure_action: pause
        monitor: 30s
```

**å›æ»šè§¦å‘æ¡ä»¶ï¼š**
```
è‡ªåŠ¨å›æ»šåœºæ™¯ï¼š
â€¢ å¥åº·æ£€æŸ¥å¤±è´¥ç‡è¶…è¿‡30%
â€¢ å®¹å™¨å¯åŠ¨å¤±è´¥
â€¢ æ›´æ–°è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸
â€¢ ç›‘æ§æŒ‡æ ‡å¼‚å¸¸ï¼ˆé”™è¯¯ç‡ã€å“åº”æ—¶é—´ï¼‰

æ‰‹åŠ¨å›æ»šåœºæ™¯ï¼š
â€¢ ä¸šåŠ¡åŠŸèƒ½å¼‚å¸¸
â€¢ æ€§èƒ½ä¸‹é™æ˜æ˜¾
â€¢ ç”¨æˆ·åé¦ˆé—®é¢˜å¢åŠ 
â€¢ ç¬¬ä¸‰æ–¹ä¾èµ–å…¼å®¹æ€§é—®é¢˜
```

### 8.7 ç›‘æ§ä¸å‘Šè­¦


#### ğŸ”¸ éƒ¨ç½²è¿‡ç¨‹ç›‘æ§

```bash
#!/bin/bash
# monitor-deployment.sh

SERVICE_NAME="web-service"
EXPECTED_REPLICAS=3

while true; do
    # è·å–æœåŠ¡çŠ¶æ€
    service_info=$(docker service ps $SERVICE_NAME --format "{{.CurrentState}}")
    
    running_count=$(echo "$service_info" | grep "Running" | wc -l)
    failed_count=$(echo "$service_info" | grep "Failed" | wc -l)
    
    echo "$(date): Running: $running_count, Failed: $failed_count"
    
    # æ£€æŸ¥æ˜¯å¦æœ‰å¤±è´¥çš„å®¹å™¨
    if [ $failed_count -gt 0 ]; then
        echo "âš ï¸  WARNING: $failed_count containers failed"
        # å‘é€å‘Šè­¦
        curl -X POST $SLACK_WEBHOOK \
             -d "{'text': 'Deployment issue: $failed_count containers failed'}"
    fi
    
    # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æœŸæœ›å‰¯æœ¬æ•°
    if [ $running_count -eq $EXPECTED_REPLICAS ]; then
        echo "âœ… All replicas running successfully"
        break
    fi
    
    sleep 10
done
```

**æ»šåŠ¨æ›´æ–°æœ€ä½³å®è·µæ€»ç»“ï¼š**
```
ğŸ¯ æ›´æ–°ç­–ç•¥é€‰æ‹©ï¼š
æ»šåŠ¨æ›´æ–°ï¼šé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼Œé›¶åœæœº
è“ç»¿éƒ¨ç½²ï¼šå¿«é€Ÿåˆ‡æ¢ï¼Œä½†éœ€è¦åŒå€èµ„æº
é‡‘ä¸é›€éƒ¨ç½²ï¼šé£é™©æ§åˆ¶ï¼Œé€‚åˆé‡è¦æ›´æ–°

ğŸ¯ å®‰å…¨ä¿éšœæªæ–½ï¼š
â€¢ å……åˆ†çš„æµ‹è¯•ç¯å¢ƒéªŒè¯
â€¢ è¯¦ç»†çš„å¥åº·æ£€æŸ¥é…ç½®
â€¢ è‡ªåŠ¨åŒ–çš„å›æ»šæœºåˆ¶
â€¢ å®æ—¶ç›‘æ§å’Œå‘Šè­¦

ğŸ¯ éƒ¨ç½²æµç¨‹è§„èŒƒï¼š
â€¢ ç‰ˆæœ¬åŒ–é•œåƒç®¡ç†
â€¢ æ¸è¿›å¼æµé‡åˆ‡æ¢
â€¢ å®Œæ•´çš„éƒ¨ç½²æ—¥å¿—
â€¢ åŠæ—¶çš„é—®é¢˜åé¦ˆæœºåˆ¶
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®¹å™¨åŒ–éƒ¨ç½²ï¼šDockeråŒ–WebæœåŠ¡çš„åŸºç¡€æ¶æ„
ğŸ”¸ é•œåƒæ„å»ºï¼šé«˜æ•ˆã€å®‰å…¨çš„é•œåƒæ„å»ºç­–ç•¥
ğŸ”¸ ç½‘ç»œé…ç½®ï¼šå®¹å™¨é—´é€šä¿¡å’ŒæœåŠ¡å‘ç°
ğŸ”¸ æ•°æ®æŒä¹…åŒ–ï¼šå·æŒ‚è½½å’Œæ•°æ®ç®¡ç†ç­–ç•¥
ğŸ”¸ é…ç½®ç®¡ç†ï¼šç¯å¢ƒå˜é‡å’Œé…ç½®æ¨¡æ¿åŒ–
ğŸ”¸ æœåŠ¡ç¼–æ’ï¼šå¤šå®¹å™¨åº”ç”¨çš„åè°ƒéƒ¨ç½²
ğŸ”¸ å¥åº·ç›‘æ§ï¼šç¡®ä¿æœåŠ¡å¯ç”¨æ€§çš„æ£€æŸ¥æœºåˆ¶
ğŸ”¸ æ»šåŠ¨æ›´æ–°ï¼šé›¶åœæœºçš„æœåŠ¡æ›´æ–°éƒ¨ç½²
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®¹å™¨åŒ–çš„æ ¸å¿ƒä»·å€¼**
```
ä¸€è‡´æ€§ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
å¯ç§»æ¤æ€§ï¼šè·¨å¹³å°ã€è·¨äº‘å‚å•†éƒ¨ç½²
å¯æ‰©å±•æ€§ï¼šå¿«é€Ÿæ°´å¹³æ‰©å±•å’Œç¼©å‡
å¯ç»´æŠ¤æ€§ï¼šç‰ˆæœ¬åŒ–ç®¡ç†å’Œå¿«é€Ÿå›æ»š
```

**ğŸ”¹ éƒ¨ç½²æ¶æ„çš„å±‚æ¬¡åŒ–**
```
åŸºç¡€è®¾æ–½å±‚ï¼šDocker Engineã€ç½‘ç»œã€å­˜å‚¨
ç¼–æ’å±‚ï¼šDocker Composeã€Swarmã€Kubernetes
åº”ç”¨å±‚ï¼šWebæœåŠ¡ã€æ•°æ®åº“ã€ç¼“å­˜
ç›‘æ§å±‚ï¼šå¥åº·æ£€æŸ¥ã€æ—¥å¿—ã€æŒ‡æ ‡æ”¶é›†
```

**ğŸ”¹ å®‰å…¨æ€§è€ƒè™‘**
```
é•œåƒå®‰å…¨ï¼šæœ€å°åŒ–é•œåƒã€érootç”¨æˆ·ã€å®šæœŸæ›´æ–°
ç½‘ç»œå®‰å…¨ï¼šç½‘ç»œéš”ç¦»ã€æœ€å°æƒé™åŸåˆ™
æ•°æ®å®‰å…¨ï¼šåŠ å¯†å­˜å‚¨ã€è®¿é—®æ§åˆ¶ã€å¤‡ä»½ç­–ç•¥
è¿è¡Œå®‰å…¨ï¼šèµ„æºé™åˆ¶ã€å®‰å…¨æ‰«æã€åˆè§„æ£€æŸ¥
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä¸åŒè§„æ¨¡åº”ç”¨çš„éƒ¨ç½²ç­–ç•¥**

```
å°å‹åº”ç”¨ï¼ˆå•æœºéƒ¨ç½²ï¼‰ï¼š
æ¶æ„ï¼šDocker Compose + å•ä¸»æœº
ç‰¹ç‚¹ï¼šç®€å•éƒ¨ç½²ã€æˆæœ¬ä½ã€é€‚åˆåˆæœŸ
ç¤ºä¾‹ï¼šdocker-compose up -d

ä¸­å‹åº”ç”¨ï¼ˆé›†ç¾¤éƒ¨ç½²ï¼‰ï¼š
æ¶æ„ï¼šDocker Swarm + å¤šä¸»æœº
ç‰¹ç‚¹ï¼šé«˜å¯ç”¨ã€è´Ÿè½½å‡è¡¡ã€è‡ªåŠ¨æ•…éšœè½¬ç§»
ç¤ºä¾‹ï¼šdocker stack deploy -c docker-compose.yml

å¤§å‹åº”ç”¨ï¼ˆäº‘åŸç”Ÿéƒ¨ç½²ï¼‰ï¼š
æ¶æ„ï¼šKubernetes + å¾®æœåŠ¡
ç‰¹ç‚¹ï¼šè‡ªåŠ¨æ‰©ç¼©ã€æœåŠ¡ç½‘æ ¼ã€DevOpsé›†æˆ
ç¤ºä¾‹ï¼škubectl apply -f k8s-manifests/
```

**ğŸ¯ ç¯å¢ƒå·®å¼‚åŒ–é…ç½®**

```
å¼€å‘ç¯å¢ƒï¼š
é‡ç‚¹ï¼šå¿«é€Ÿè¿­ä»£ã€è°ƒè¯•ä¾¿åˆ©
é…ç½®ï¼šä»£ç çƒ­é‡è½½ã€æš´éœ²è°ƒè¯•ç«¯å£ã€è¯¦ç»†æ—¥å¿—

æµ‹è¯•ç¯å¢ƒï¼š
é‡ç‚¹ï¼šæ¥è¿‘ç”Ÿäº§ã€è‡ªåŠ¨åŒ–æµ‹è¯•
é…ç½®ï¼šå®Œæ•´çš„æœåŠ¡æ ˆã€æµ‹è¯•æ•°æ®ã€ç›‘æ§

ç”Ÿäº§ç¯å¢ƒï¼š
é‡ç‚¹ï¼šé«˜å¯ç”¨ã€æ€§èƒ½ã€å®‰å…¨
é…ç½®ï¼šè´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥ã€å®‰å…¨åŠ å›º
```

### 9.4 æ•…éšœè¯Šæ–­ä¸è§£å†³


**ğŸ”§ å¸¸è§é—®é¢˜å¤„ç†æµç¨‹**

```
å®¹å™¨å¯åŠ¨å¤±è´¥ï¼š
æ£€æŸ¥é¡¹ï¼šé•œåƒæ˜¯å¦å­˜åœ¨ã€ç«¯å£æ˜¯å¦å†²çªã€èµ„æºæ˜¯å¦å……è¶³
è§£å†³ï¼šdocker logs <container> æŸ¥çœ‹é”™è¯¯æ—¥å¿—

æœåŠ¡æ— æ³•è®¿é—®ï¼š
æ£€æŸ¥é¡¹ï¼šç«¯å£æ˜ å°„ã€ç½‘ç»œé…ç½®ã€é˜²ç«å¢™è®¾ç½®
è§£å†³ï¼šdocker port <container> ç¡®è®¤ç«¯å£æ˜ å°„

æ•°æ®ä¸¢å¤±é—®é¢˜ï¼š
æ£€æŸ¥é¡¹ï¼šå·æŒ‚è½½é…ç½®ã€æƒé™è®¾ç½®ã€å¤‡ä»½ç­–ç•¥
è§£å†³ï¼šä½¿ç”¨å‘½åå·ã€å®šæœŸå¤‡ä»½ã€æƒé™ä¿®å¤

æ€§èƒ½é—®é¢˜ï¼š
æ£€æŸ¥é¡¹ï¼šèµ„æºé™åˆ¶ã€å¥åº·æ£€æŸ¥é…ç½®ã€è´Ÿè½½åˆ†å¸ƒ
è§£å†³ï¼šè°ƒæ•´èµ„æºé™åˆ¶ã€ä¼˜åŒ–å¥åº·æ£€æŸ¥ã€è´Ÿè½½å‡è¡¡
```

### 9.5 æŒç»­æ”¹è¿›ç­–ç•¥


**ğŸš€ è¿ç»´ä¼˜åŒ–æ–¹å‘**

```
è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼š
å½“å‰ï¼šæ‰‹åŠ¨éƒ¨ç½² â†’ ç›®æ ‡ï¼šå…¨è‡ªåŠ¨CI/CD
å·¥å…·ï¼šGitLab CIã€Jenkinsã€GitHub Actions

ç›‘æ§å®Œå–„ï¼š
å½“å‰ï¼šåŸºç¡€ç›‘æ§ â†’ ç›®æ ‡ï¼šå…¨æ–¹ä½å¯è§‚æµ‹æ€§
å·¥å…·ï¼šPrometheusã€Grafanaã€ELK Stack

å®‰å…¨åŠ å›ºï¼š
å½“å‰ï¼šåŸºç¡€å®‰å…¨ â†’ ç›®æ ‡ï¼šé›¶ä¿¡ä»»æ¶æ„
å·¥å…·ï¼šé•œåƒæ‰«æã€è¿è¡Œæ—¶å®‰å…¨ã€ç½‘ç»œç­–ç•¥

æˆæœ¬ä¼˜åŒ–ï¼š
å½“å‰ï¼šå›ºå®šèµ„æº â†’ ç›®æ ‡ï¼šå¼¹æ€§ä¼¸ç¼©
ç­–ç•¥ï¼šæŒ‰éœ€æ‰©ç¼©ã€èµ„æºæ± åŒ–ã€æˆæœ¬ç›‘æ§
```

**ğŸ”„ æŠ€æœ¯æ¼”è¿›è·¯å¾„**

```
é˜¶æ®µ1ï¼šå•ä½“å®¹å™¨åŒ–
Docker + å•æœºéƒ¨ç½²
å­¦ä¹ å®¹å™¨åŸºç¡€æ¦‚å¿µ

é˜¶æ®µ2ï¼šæœåŠ¡ç¼–æ’åŒ–  
Docker Compose + å¤šæœåŠ¡
æŒæ¡æœåŠ¡é—´åè°ƒ

é˜¶æ®µ3ï¼šé›†ç¾¤åŒ–éƒ¨ç½²
Docker Swarm + é«˜å¯ç”¨
å®ç°ç”Ÿäº§çº§éƒ¨ç½²

é˜¶æ®µ4ï¼šäº‘åŸç”ŸåŒ–
Kubernetes + å¾®æœåŠ¡
è¾¾åˆ°ä¼ä¸šçº§æ ‡å‡†
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹ï¼š**
- å®¹å™¨åŒ–æ˜¯ç°ä»£åº”ç”¨éƒ¨ç½²çš„åŸºç¡€ï¼Œæä¾›ä¸€è‡´æ€§å’Œå¯ç§»æ¤æ€§
- é•œåƒæ„å»ºè¦è€ƒè™‘å®‰å…¨ã€æ€§èƒ½å’Œç»´æŠ¤æ€§
- ç½‘ç»œå’Œå­˜å‚¨é…ç½®ç›´æ¥å½±å“åº”ç”¨çš„å¯ç”¨æ€§å’Œæ€§èƒ½
- å¥åº·æ£€æŸ¥å’Œæ»šåŠ¨æ›´æ–°æ˜¯ä¿éšœæœåŠ¡ç¨³å®šæ€§çš„å…³é”®æœºåˆ¶
- ç¯å¢ƒå·®å¼‚åŒ–é…ç½®ç®¡ç†æ˜¯å®ç°å¤šç¯å¢ƒéƒ¨ç½²çš„æ ¸å¿ƒ
- ç›‘æ§å’Œå‘Šè­¦ä½“ç³»æ˜¯è¿ç»´è‡ªåŠ¨åŒ–çš„é‡è¦åŸºç¡€