---
title: 5ã€Nginxåå‘ä»£ç†é…ç½®
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯åå‘ä»£ç†](#1-ä»€ä¹ˆæ˜¯åå‘ä»£ç†)
2. [proxy_passæ ¸å¿ƒæŒ‡ä»¤è¯¦è§£](#2-proxy_passæ ¸å¿ƒæŒ‡ä»¤è¯¦è§£)
3. [upstreamåç«¯æœåŠ¡å™¨æ± ](#3-upstreamåç«¯æœåŠ¡å™¨æ± )
4. [è¯·æ±‚å¤´å¤„ç†æœºåˆ¶](#4-è¯·æ±‚å¤´å¤„ç†æœºåˆ¶)
5. [è´Ÿè½½å‡è¡¡ç®—æ³•é…ç½®](#5-è´Ÿè½½å‡è¡¡ç®—æ³•é…ç½®)
6. [åç«¯å¥åº·æ£€æŸ¥](#6-åç«¯å¥åº·æ£€æŸ¥)
7. [ä»£ç†ç¼“å­˜é…ç½®](#7-ä»£ç†ç¼“å­˜é…ç½®)
8. [è¶…æ—¶å‚æ•°è°ƒä¼˜](#8-è¶…æ—¶å‚æ•°è°ƒä¼˜)
9. [æ•…éšœè½¬ç§»ä¸å¤‡ç”¨æœåŠ¡å™¨](#9-æ•…éšœè½¬ç§»ä¸å¤‡ç”¨æœåŠ¡å™¨)
10. [å®æˆ˜é…ç½®ç¤ºä¾‹](#10-å®æˆ˜é…ç½®ç¤ºä¾‹)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ ä»€ä¹ˆæ˜¯åå‘ä»£ç†


### 1.1 åå‘ä»£ç†åŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šåå‘ä»£ç†å°±åƒæ˜¯ä¸€ä¸ª"ä¸­è½¬ç«™"ï¼Œå®¢æˆ·ç«¯ä»¥ä¸ºåœ¨ç›´æ¥è®¿é—®ç½‘ç«™ï¼Œå®é™…ä¸Šæ˜¯ä»£ç†æœåŠ¡å™¨åœ¨èƒŒåå¸®ä½ è½¬å‘è¯·æ±‚åˆ°çœŸæ­£çš„åç«¯æœåŠ¡å™¨ã€‚

```
æ­£å‘ä»£ç†ï¼ˆç¿»å¢™ï¼‰ï¼š     åå‘ä»£ç†ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ï¼š
å®¢æˆ·ç«¯ â†’ ä»£ç† â†’ ç½‘ç«™    å®¢æˆ·ç«¯ â†’ Nginx â†’ åç«¯æœåŠ¡å™¨

éšè—çš„æ˜¯å®¢æˆ·ç«¯èº«ä»½      éšè—çš„æ˜¯æœåŠ¡å™¨ç»†èŠ‚
```

### 1.2 åå‘ä»£ç†çš„ä½œç”¨


**ğŸ¯ æ ¸å¿ƒä½œç”¨**ï¼š
- **è´Ÿè½½åˆ†æ‹…**ï¼šæŠŠè¯·æ±‚åˆ†å‘ç»™å¤šå°åç«¯æœåŠ¡å™¨
- **éšè—åç«¯**ï¼šå®¢æˆ·ç«¯çœ‹ä¸åˆ°çœŸå®çš„åç«¯æœåŠ¡å™¨
- **SSLç»ˆæ­¢**ï¼šåœ¨ä»£ç†å±‚å¤„ç†HTTPSåŠ è§£å¯†
- **ç¼“å­˜åŠ é€Ÿ**ï¼šç¼“å­˜çƒ­ç‚¹å†…å®¹ï¼Œæå‡å“åº”é€Ÿåº¦
- **å®‰å…¨é˜²æŠ¤**ï¼šè¿‡æ»¤æ¶æ„è¯·æ±‚ï¼Œä¿æŠ¤åç«¯æœåŠ¡å™¨

**ğŸ’¡ ç”Ÿæ´»ä¸­çš„ç±»æ¯”**ï¼š
> åå‘ä»£ç†åƒæ˜¯é¤å…çš„æœåŠ¡å‘˜ï¼Œé¡¾å®¢ç‚¹é¤åï¼ŒæœåŠ¡å‘˜æŠŠè®¢å•è½¬ç»™åå¨ï¼ˆåç«¯æœåŠ¡å™¨ï¼‰ï¼Œç„¶åæŠŠåšå¥½çš„èœç«¯ç»™é¡¾å®¢ã€‚é¡¾å®¢ä¸éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªå¨å¸ˆåšçš„èœï¼Œä¹Ÿä¸ç”¨ç›´æ¥è·Ÿå¨å¸ˆæ²Ÿé€šã€‚

---

## 2. ğŸš€ proxy_passæ ¸å¿ƒæŒ‡ä»¤è¯¦è§£


### 2.1 proxy_passåŸºæœ¬è¯­æ³•


**åŸºç¡€è¯­æ³•**ï¼š
```nginx
location /api/ {
    proxy_pass http://backend_server;
}
```

**ğŸ”¸ å…³é”®ç†è§£**ï¼š`proxy_pass`æ˜¯Nginxåå‘ä»£ç†çš„æ ¸å¿ƒæŒ‡ä»¤ï¼Œå‘Šè¯‰NginxæŠŠè¯·æ±‚è½¬å‘åˆ°å“ªé‡Œã€‚

### 2.2 URLè·¯å¾„å¤„ç†è§„åˆ™


**è§„åˆ™â‘  æœ‰æ–œæ çš„æƒ…å†µ**ï¼š
```nginx
# é…ç½®ï¼šproxy_passåé¢æœ‰æ–œæ 
location /api/ {
    proxy_pass http://192.168.1.100/;
}

# ç»“æœï¼šè®¿é—® /api/users â†’ è½¬å‘åˆ° http://192.168.1.100/users
# è¯´æ˜ï¼š/api/è¢«æ›¿æ¢ä¸º/
```

**è§„åˆ™â‘¡ æ— æ–œæ çš„æƒ…å†µ**ï¼š
```nginx
# é…ç½®ï¼šproxy_passåé¢æ— æ–œæ 
location /api/ {
    proxy_pass http://192.168.1.100;
}

# ç»“æœï¼šè®¿é—® /api/users â†’ è½¬å‘åˆ° http://192.168.1.100/api/users
# è¯´æ˜ï¼šå®Œæ•´è·¯å¾„è¢«ä¿ç•™
```

**è§„åˆ™â‘¢ æŒ‡å®šè·¯å¾„çš„æƒ…å†µ**ï¼š
```nginx
# é…ç½®ï¼šproxy_passæŒ‡å®šäº†å…·ä½“è·¯å¾„
location /old-api/ {
    proxy_pass http://192.168.1.100/new-api/;
}

# ç»“æœï¼šè®¿é—® /old-api/users â†’ è½¬å‘åˆ° http://192.168.1.100/new-api/users
# è¯´æ˜ï¼š/old-api/è¢«æ›¿æ¢ä¸º/new-api/
```

### 2.3 å¸¸ç”¨proxy_passé…ç½®æ¨¡å¼


**æ¨¡å¼å¯¹æ¯”è¡¨**ï¼š

| **é…ç½®æ¨¡å¼** | **ç¤ºä¾‹** | **è½¬å‘ç»“æœ** | **ä½¿ç”¨åœºæ™¯** |
|-------------|----------|-------------|-------------|
| ğŸ”¸ **ç›´æ¥è½¬å‘** | `proxy_pass http://backend;` | `å®Œæ•´è·¯å¾„ä¿ç•™` | `ç®€å•ä»£ç†ï¼Œè·¯å¾„ä¸å˜` |
| ğŸ”¸ **è·¯å¾„æ›¿æ¢** | `proxy_pass http://backend/;` | `ç§»é™¤locationè·¯å¾„` | `åç«¯APIè·¯å¾„ä¸åŒ` |
| ğŸ”¸ **è·¯å¾„é‡å†™** | `proxy_pass http://backend/api/;` | `æ›¿æ¢ä¸ºæŒ‡å®šè·¯å¾„` | `ç‰ˆæœ¬å‡çº§ï¼Œè·¯å¾„è¿ç§»` |

---

## 3. ğŸ—ï¸ upstreamåç«¯æœåŠ¡å™¨æ± 


### 3.1 upstreamåŸºæœ¬é…ç½®


**åŸºç¡€å®šä¹‰**ï¼šupstreamå°±æ˜¯å®šä¹‰ä¸€ç»„åç«¯æœåŠ¡å™¨ï¼Œè®©NginxçŸ¥é“å¯ä»¥æŠŠè¯·æ±‚è½¬å‘ç»™å“ªäº›æœåŠ¡å™¨ã€‚

```nginx
# å®šä¹‰æœåŠ¡å™¨ç»„
upstream backend_pool {
    server 192.168.1.101:8080;
    server 192.168.1.102:8080;
    server 192.168.1.103:8080;
}

# ä½¿ç”¨æœåŠ¡å™¨ç»„
location /api/ {
    proxy_pass http://backend_pool;
}
```

### 3.2 æœåŠ¡å™¨å‚æ•°é…ç½®


**ğŸ”§ é‡è¦å‚æ•°è¯´æ˜**ï¼š

```nginx
upstream web_servers {
    # åŸºæœ¬æœåŠ¡å™¨
    server 192.168.1.101:8080;
    
    # å¸¦æƒé‡çš„æœåŠ¡å™¨ï¼ˆå¤„ç†èƒ½åŠ›å¼ºï¼‰
    server 192.168.1.102:8080 weight=3;
    
    # å¤‡ç”¨æœåŠ¡å™¨ï¼ˆå…¶ä»–éƒ½æŒ‚äº†æ‰ç”¨ï¼‰
    server 192.168.1.103:8080 backup;
    
    # æ•…éšœæ£€æµ‹é…ç½®
    server 192.168.1.104:8080 max_fails=3 fail_timeout=30s;
}
```

**å‚æ•°è¯¦è§£**ï¼š
- **weight**ï¼šæƒé‡ï¼Œæ•°å­—è¶Šå¤§åˆ†é…çš„è¯·æ±‚è¶Šå¤š
- **backup**ï¼šå¤‡ç”¨æœåŠ¡å™¨ï¼Œåªæœ‰ä¸»æœåŠ¡å™¨éƒ½æ•…éšœæ—¶æ‰å¯ç”¨
- **max_fails**ï¼šæœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œè¶…è¿‡åè®¤ä¸ºæœåŠ¡å™¨æ•…éšœ
- **fail_timeout**ï¼šæ•…éšœè¶…æ—¶æ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…ä¸ä¼šå†å°è¯•è®¿é—®æ•…éšœæœåŠ¡å™¨

### 3.3 upstreamé…ç½®å®ä¾‹


**ğŸ“‹ å®é™…ç”Ÿäº§é…ç½®ç¤ºä¾‹**ï¼š
```nginx
upstream api_servers {
    # ä¸»è¦æœåŠ¡å™¨ï¼Œé«˜é…ç½®ï¼Œæƒé‡å¤§
    server 10.0.1.10:8080 weight=5 max_fails=2 fail_timeout=10s;
    server 10.0.1.11:8080 weight=5 max_fails=2 fail_timeout=10s;
    
    # æ™®é€šæœåŠ¡å™¨
    server 10.0.1.12:8080 weight=2 max_fails=3 fail_timeout=30s;
    
    # å¤‡ç”¨æœåŠ¡å™¨ï¼Œåªæœ‰ä¸»æœåŠ¡å™¨éƒ½æŒ‚äº†æ‰ç”¨
    server 10.0.1.13:8080 backup;
    
    # è¿æ¥ä¿æŒé…ç½®
    keepalive 32;
}
```

---

## 4. ğŸ“¨ è¯·æ±‚å¤´å¤„ç†æœºåˆ¶


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®è¯·æ±‚å¤´


**é—®é¢˜åœºæ™¯**ï¼šåç«¯æœåŠ¡å™¨æ”¶åˆ°ä»£ç†è¯·æ±‚æ—¶ï¼Œçœ‹åˆ°çš„å®¢æˆ·ç«¯IPæ˜¯Nginxçš„IPï¼Œè€Œä¸æ˜¯çœŸå®ç”¨æˆ·çš„IPï¼Œè¿™ä¼šå¯¼è‡´ï¼š
- âŒ æ— æ³•è·å–çœŸå®å®¢æˆ·ç«¯IP
- âŒ æ— æ³•æ­£ç¡®å¤„ç†åŸºäºIPçš„é€»è¾‘
- âŒ æ—¥å¿—è®°å½•ä¸å‡†ç¡®

### 4.2 æ ¸å¿ƒè¯·æ±‚å¤´è®¾ç½®


**ğŸ”§ å¿…å¤‡è¯·æ±‚å¤´é…ç½®**ï¼š
```nginx
location /api/ {
    proxy_pass http://backend_pool;
    
    # ä¿æŒåŸå§‹Hostå¤´
    proxy_set_header Host $host;
    
    # ä¼ é€’çœŸå®å®¢æˆ·ç«¯IP
    proxy_set_header X-Real-IP $remote_addr;
    
    # è½¬å‘é“¾è·¯IPè®°å½•
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    
    # æ ‡è¯†åè®®ç±»å‹
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

### 4.3 è¯·æ±‚å¤´è¯¦ç»†è¯´æ˜


**ğŸ“‹ å…³é”®è¯·æ±‚å¤´å«ä¹‰**ï¼š

| **è¯·æ±‚å¤´** | **ä½œç”¨** | **ç¤ºä¾‹å€¼** |
|-----------|---------|-----------|
| **Host** | `ä¿æŒåŸå§‹åŸŸå` | `www.example.com` |
| **X-Real-IP** | `çœŸå®å®¢æˆ·ç«¯IP` | `203.0.113.45` |
| **X-Forwarded-For** | `ä»£ç†é“¾è·¯IPåˆ—è¡¨` | `203.0.113.45, 10.0.1.1` |
| **X-Forwarded-Proto** | `åŸå§‹åè®®ç±»å‹` | `https` |

**ğŸ’¡ X-Forwarded-For è¯¦è§£**ï¼š
```
å®¢æˆ·ç«¯ â†’ CDN â†’ Nginx â†’ åç«¯
  A   â†’  B  â†’   C   â†’   D

X-Forwarded-For: A, B, C
è¯´æ˜ï¼šè®°å½•äº†å®Œæ•´çš„ä»£ç†é“¾è·¯
```

### 4.4 è‡ªå®šä¹‰è¯·æ±‚å¤´


**é«˜çº§é…ç½®ç¤ºä¾‹**ï¼š
```nginx
location /api/ {
    proxy_pass http://backend_pool;
    
    # åŸºç¡€å¤´éƒ¨
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # è‡ªå®šä¹‰ä¸šåŠ¡å¤´éƒ¨
    proxy_set_header X-Request-ID $request_id;
    proxy_set_header X-Nginx-Server $hostname;
    
    # ç§»é™¤ä¸éœ€è¦çš„å¤´éƒ¨
    proxy_set_header Authorization "";
}
```

---

## 5. âš–ï¸ è´Ÿè½½å‡è¡¡ç®—æ³•é…ç½®


### 5.1 è´Ÿè½½å‡è¡¡ç®—æ³•æ¦‚è¿°


**ç®€å•ç†è§£**ï¼šè´Ÿè½½å‡è¡¡ç®—æ³•å†³å®šäº†Nginxå¦‚ä½•åœ¨å¤šä¸ªåç«¯æœåŠ¡å™¨ä¹‹é—´åˆ†é…è¯·æ±‚ã€‚

### 5.2 è½®è¯¢ç®—æ³•ï¼ˆé»˜è®¤ï¼‰


**ğŸ”„ è½®è¯¢ç®—æ³•**ï¼š
```nginx
upstream backend {
    server 192.168.1.101;
    server 192.168.1.102;
    server 192.168.1.103;
    # é»˜è®¤å°±æ˜¯è½®è¯¢ï¼Œä¸éœ€è¦ç‰¹æ®Šé…ç½®
}
```

**å·¥ä½œåŸç†**ï¼š
```
è¯·æ±‚1 â†’ æœåŠ¡å™¨1
è¯·æ±‚2 â†’ æœåŠ¡å™¨2  
è¯·æ±‚3 â†’ æœåŠ¡å™¨3
è¯·æ±‚4 â†’ æœåŠ¡å™¨1ï¼ˆå¾ªç¯å¼€å§‹ï¼‰
```

### 5.3 åŠ æƒè½®è¯¢ç®—æ³•


**âš–ï¸ åŠ æƒè½®è¯¢**ï¼š
```nginx
upstream backend {
    server 192.168.1.101 weight=1;  # æ€§èƒ½ä¸€èˆ¬
    server 192.168.1.102 weight=3;  # æ€§èƒ½å¥½ï¼Œå¤šåˆ†é…
    server 192.168.1.103 weight=2;  # æ€§èƒ½ä¸­ç­‰
}
```

**åˆ†é…æ¯”ä¾‹**ï¼šæœåŠ¡å™¨1:æœåŠ¡å™¨2:æœåŠ¡å™¨3 = 1:3:2

### 5.4 IPå“ˆå¸Œç®—æ³•


**ğŸ”— IPå“ˆå¸Œç®—æ³•**ï¼š
```nginx
upstream backend {
    ip_hash;  # å¯ç”¨IPå“ˆå¸Œ
    server 192.168.1.101;
    server 192.168.1.102;
    server 192.168.1.103;
}
```

**ä½œç”¨**ï¼šåŒä¸€ä¸ªå®¢æˆ·ç«¯IPçš„è¯·æ±‚æ€»æ˜¯è½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼Œå®ç°ä¼šè¯ç²˜æ€§ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… éœ€è¦ä¿æŒç”¨æˆ·ä¼šè¯çŠ¶æ€
- âœ… åç«¯æœåŠ¡å™¨æœ‰æœ¬åœ°ç¼“å­˜
- âŒ å®¢æˆ·ç«¯IPåˆ†å¸ƒä¸å‡åŒ€æ—¶ä¸é€‚ç”¨

### 5.5 æœ€å°‘è¿æ¥ç®—æ³•


**ğŸ“Š æœ€å°‘è¿æ¥ç®—æ³•**ï¼š
```nginx
upstream backend {
    least_conn;  # å¯ç”¨æœ€å°‘è¿æ¥
    server 192.168.1.101;
    server 192.168.1.102;
    server 192.168.1.103;
}
```

**åŸç†**ï¼šæŠŠæ–°è¯·æ±‚åˆ†é…ç»™å½“å‰æ´»è·ƒè¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ã€‚

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… è¯·æ±‚å¤„ç†æ—¶é—´å·®å¼‚è¾ƒå¤§
- âœ… é•¿è¿æ¥è¾ƒå¤šçš„åœºæ™¯

### 5.6 è´Ÿè½½å‡è¡¡ç®—æ³•å¯¹æ¯”


```
ç®—æ³•é€‰æ‹©æŒ‡å—ï¼š

ğŸ”„ è½®è¯¢ï¼ˆé»˜è®¤ï¼‰
â”œâ”€ ä¼˜ç‚¹ï¼šç®€å•ã€å…¬å¹³
â”œâ”€ ç¼ºç‚¹ï¼šä¸è€ƒè™‘æœåŠ¡å™¨æ€§èƒ½å·®å¼‚
â””â”€ åœºæ™¯ï¼šæœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘

âš–ï¸ åŠ æƒè½®è¯¢
â”œâ”€ ä¼˜ç‚¹ï¼šè€ƒè™‘æœåŠ¡å™¨æ€§èƒ½å·®å¼‚
â”œâ”€ ç¼ºç‚¹ï¼šæƒé‡è®¾ç½®éœ€è¦ç»éªŒ
â””â”€ åœºæ™¯ï¼šæœåŠ¡å™¨æ€§èƒ½ä¸åŒ

ğŸ”— IPå“ˆå¸Œ
â”œâ”€ ä¼˜ç‚¹ï¼šä¼šè¯ç²˜æ€§
â”œâ”€ ç¼ºç‚¹ï¼šå¯èƒ½åˆ†å¸ƒä¸å‡
â””â”€ åœºæ™¯ï¼šéœ€è¦ä¼šè¯ä¿æŒ

ğŸ“Š æœ€å°‘è¿æ¥
â”œâ”€ ä¼˜ç‚¹ï¼šåŠ¨æ€è´Ÿè½½å‡è¡¡
â”œâ”€ ç¼ºç‚¹ï¼šè®¡ç®—å¼€é”€ç¨å¤§
â””â”€ åœºæ™¯ï¼šè¯·æ±‚å¤„ç†æ—¶é—´å·®å¼‚å¤§
```

---

## 6. ğŸ” åç«¯å¥åº·æ£€æŸ¥


### 6.1 å¥åº·æ£€æŸ¥çš„é‡è¦æ€§


**é—®é¢˜åœºæ™¯**ï¼šå¦‚æœåç«¯æœåŠ¡å™¨æ•…éšœäº†ï¼Œä½†Nginxä¸çŸ¥é“ï¼Œè¿˜ç»§ç»­è½¬å‘è¯·æ±‚è¿‡å»ï¼Œç”¨æˆ·å°±ä¼šçœ‹åˆ°é”™è¯¯é¡µé¢ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šé€šè¿‡å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œè‡ªåŠ¨å‘ç°æ•…éšœæœåŠ¡å™¨å¹¶åœæ­¢å‘å…¶è½¬å‘è¯·æ±‚ã€‚

### 6.2 è¢«åŠ¨å¥åº·æ£€æŸ¥


**ğŸ”§ åŸºç¡€é…ç½®**ï¼š
```nginx
upstream backend {
    server 192.168.1.101 max_fails=3 fail_timeout=30s;
    server 192.168.1.102 max_fails=3 fail_timeout=30s;
    server 192.168.1.103 max_fails=3 fail_timeout=30s;
}
```

**å‚æ•°è¯´æ˜**ï¼š
- **max_fails=3**ï¼šè¿ç»­å¤±è´¥3æ¬¡åè®¤ä¸ºæœåŠ¡å™¨æ•…éšœ
- **fail_timeout=30s**ï¼šæ•…éšœå30ç§’å†…ä¸å†å°è¯•è®¿é—®

**å·¥ä½œæµç¨‹**ï¼š
```
æ­£å¸¸è¯·æ±‚ â†’ åç«¯å“åº”OK â†’ è®¡æ•°å™¨æ¸…é›¶
æ•…éšœè¯·æ±‚ â†’ åç«¯æ— å“åº” â†’ å¤±è´¥è®¡æ•°+1
å¤±è´¥3æ¬¡ â†’ æ ‡è®°ä¸ºæ•…éšœ â†’ åœæ­¢è½¬å‘30ç§’
30ç§’å â†’ å°è¯•æ¢å¤ â†’ æˆåŠŸåˆ™æ¢å¤æ­£å¸¸
```

### 6.3 ä¸»åŠ¨å¥åº·æ£€æŸ¥ï¼ˆéœ€è¦å•†ä¸šç‰ˆæˆ–ç¬¬ä¸‰æ–¹æ¨¡å—ï¼‰


**æ¦‚å¿µ**ï¼šå®šæœŸä¸»åŠ¨å‘åç«¯æœåŠ¡å™¨å‘é€å¥åº·æ£€æŸ¥è¯·æ±‚ã€‚

```nginx
upstream backend {
    server 192.168.1.101;
    server 192.168.1.102;
    
    # éœ€è¦nginx-plusæˆ–ç¬¬ä¸‰æ–¹æ¨¡å—
    health_check interval=5s fails=3 passes=2;
}
```

### 6.4 è‡ªå®šä¹‰å¥åº·æ£€æŸ¥è„šæœ¬


**ğŸ’¡ å®ç”¨æŠ€å·§**ï¼šé€šè¿‡å¤–éƒ¨è„šæœ¬å®ç°ä¸»åŠ¨å¥åº·æ£€æŸ¥ï¼š

```bash
#!/bin/bash
# health_check.sh
SERVERS=("192.168.1.101:8080" "192.168.1.102:8080")

for server in "${SERVERS[@]}"; do
    if curl -f -s "http://$server/health" > /dev/null; then
        echo "$server å¥åº·"
    else
        echo "$server æ•…éšœï¼Œéœ€è¦å¤„ç†"
        # å¯ä»¥é›†æˆå‘Šè­¦ç³»ç»Ÿ
    fi
done
```

---

## 7. ğŸ“¦ ä»£ç†ç¼“å­˜é…ç½®


### 7.1 ä»£ç†ç¼“å­˜çš„ä½œç”¨


**æ ¸å¿ƒä½œç”¨**ï¼šæŠŠåç«¯æœåŠ¡å™¨çš„å“åº”ç¼“å­˜åœ¨Nginxä¸­ï¼Œä¸‹æ¬¡ç›¸åŒè¯·æ±‚ç›´æ¥è¿”å›ç¼“å­˜å†…å®¹ï¼Œä¸éœ€è¦å†è®¿é—®åç«¯ã€‚

**å¥½å¤„**ï¼š
- âš¡ å“åº”æ›´å¿«
- ğŸ“‰ å‡å°‘åç«¯å‹åŠ›
- ğŸ’° èŠ‚çœå¸¦å®½

### 7.2 åŸºç¡€ç¼“å­˜é…ç½®


**ğŸ”§ ç¼“å­˜åŒºåŸŸå®šä¹‰**ï¼š
```nginx
# åœ¨httpå—ä¸­å®šä¹‰ç¼“å­˜åŒºåŸŸ
http {
    # å®šä¹‰ç¼“å­˜å­˜å‚¨è·¯å¾„å’Œå‚æ•°
    proxy_cache_path /var/cache/nginx/proxy 
                     levels=1:2 
                     keys_zone=api_cache:10m 
                     max_size=1g 
                     inactive=60m;
}
```

**å‚æ•°è¯´æ˜**ï¼š
- **levels=1:2**ï¼šç¼“å­˜ç›®å½•å±‚çº§ç»“æ„
- **keys_zone=api_cache:10m**ï¼šç¼“å­˜ç´¢å¼•åŒºåŸŸåç§°å’Œå¤§å°
- **max_size=1g**ï¼šæœ€å¤§ç¼“å­˜å¤§å°
- **inactive=60m**ï¼š60åˆ†é’Ÿå†…æœªè®¿é—®çš„ç¼“å­˜å°†è¢«æ¸…ç†

### 7.3 locationç¼“å­˜é…ç½®


**ğŸ“ åœ¨locationä¸­å¯ç”¨ç¼“å­˜**ï¼š
```nginx
location /api/ {
    proxy_pass http://backend_pool;
    
    # å¯ç”¨ç¼“å­˜
    proxy_cache api_cache;
    
    # ç¼“å­˜æœ‰æ•ˆæœŸ
    proxy_cache_valid 200 302 10m;  # æˆåŠŸå“åº”ç¼“å­˜10åˆ†é’Ÿ
    proxy_cache_valid 404 1m;       # 404å“åº”ç¼“å­˜1åˆ†é’Ÿ
    
    # ç¼“å­˜é”®å€¼
    proxy_cache_key $scheme$proxy_host$uri$is_args$args;
    
    # æ·»åŠ ç¼“å­˜çŠ¶æ€å¤´
    add_header X-Cache-Status $upstream_cache_status;
}
```

### 7.4 ç¼“å­˜æ§åˆ¶ç­–ç•¥


**ğŸ›ï¸ é«˜çº§ç¼“å­˜é…ç½®**ï¼š
```nginx
location /api/ {
    proxy_pass http://backend_pool;
    proxy_cache api_cache;
    
    # ç¼“å­˜ç»•è¿‡æ¡ä»¶
    proxy_cache_bypass $cookie_nocache $arg_nocache;
    
    # ä¸ç¼“å­˜çš„æ¡ä»¶
    proxy_no_cache $cookie_nocache $arg_nocache;
    
    # æœ€å°ä½¿ç”¨æ¬¡æ•°ï¼ˆè¢«è¯·æ±‚2æ¬¡åæ‰ç¼“å­˜ï¼‰
    proxy_cache_min_uses 2;
    
    # ç¼“å­˜é”ï¼ˆé˜²æ­¢ç¼“å­˜é›ªå´©ï¼‰
    proxy_cache_lock on;
    proxy_cache_lock_timeout 5s;
}
```

### 7.5 ç¼“å­˜çŠ¶æ€è¯´æ˜


**ğŸ“Š ç¼“å­˜çŠ¶æ€å€¼**ï¼š

| **çŠ¶æ€** | **å«ä¹‰** | **è¯´æ˜** |
|---------|---------|---------|
| **HIT** | `ç¼“å­˜å‘½ä¸­` | `ç›´æ¥ä»ç¼“å­˜è¿”å›` |
| **MISS** | `ç¼“å­˜æœªå‘½ä¸­` | `ä»åç«¯è·å–å¹¶ç¼“å­˜` |
| **BYPASS** | `ç»•è¿‡ç¼“å­˜` | `ä¸ä½¿ç”¨ç¼“å­˜` |
| **EXPIRED** | `ç¼“å­˜è¿‡æœŸ` | `ç¼“å­˜å·²è¿‡æœŸï¼Œé‡æ–°è·å–` |

---

## 8. â±ï¸ è¶…æ—¶å‚æ•°è°ƒä¼˜


### 8.1 è¶…æ—¶å‚æ•°çš„é‡è¦æ€§


**é—®é¢˜åœºæ™¯**ï¼šå¦‚æœåç«¯æœåŠ¡å™¨å“åº”æ…¢ï¼ŒNginxä¼šä¸€ç›´ç­‰å¾…ï¼Œå¯¼è‡´ç”¨æˆ·ä½“éªŒå·®ï¼Œç”šè‡³è€—å°½è¿æ¥èµ„æºã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆç†è®¾ç½®å„ç§è¶…æ—¶å‚æ•°ï¼Œåœ¨æ€§èƒ½å’Œç¨³å®šæ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚

### 8.2 æ ¸å¿ƒè¶…æ—¶å‚æ•°


**ğŸ• å…³é”®è¶…æ—¶é…ç½®**ï¼š
```nginx
location /api/ {
    proxy_pass http://backend_pool;
    
    # è¿æ¥åç«¯æœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´
    proxy_connect_timeout 30s;
    
    # å‘åç«¯å‘é€è¯·æ±‚çš„è¶…æ—¶æ—¶é—´
    proxy_send_timeout 60s;
    
    # æ¥æ”¶åç«¯å“åº”çš„è¶…æ—¶æ—¶é—´
    proxy_read_timeout 60s;
    
    # ä¸‹ä¸€ä¸ªupstreamçš„å°è¯•è¶…æ—¶
    proxy_next_upstream_timeout 0;
    
    # å°è¯•ä¸‹ä¸€ä¸ªupstreamçš„æ¬¡æ•°
    proxy_next_upstream_tries 0;
}
```

### 8.3 è¶…æ—¶å‚æ•°è¯¦è§£


**ğŸ“‹ å‚æ•°å«ä¹‰è¯´æ˜**ï¼š

```
è¶…æ—¶æµç¨‹å›¾ï¼š

å®¢æˆ·ç«¯è¯·æ±‚ â†’ Nginx â†’ åç«¯æœåŠ¡å™¨
     â†“         â†“         â†“
   æ— è¶…æ—¶   è¿æ¥è¶…æ—¶   å¤„ç†è¶…æ—¶
            30s       60s

è¿æ¥é˜¶æ®µï¼šproxy_connect_timeout
å‘é€é˜¶æ®µï¼šproxy_send_timeout  
æ¥æ”¶é˜¶æ®µï¼šproxy_read_timeout
```

| **å‚æ•°** | **é»˜è®¤å€¼** | **å»ºè®®å€¼** | **è¯´æ˜** |
|---------|-----------|-----------|---------|
| **proxy_connect_timeout** | `60s` | `5-30s` | `è¿æ¥å»ºç«‹æ—¶é—´ï¼Œé€šå¸¸å¾ˆå¿«` |
| **proxy_send_timeout** | `60s` | `30-60s` | `å‘é€è¯·æ±‚æ•°æ®æ—¶é—´` |
| **proxy_read_timeout** | `60s` | `30-300s` | `è¯»å–å“åº”æ—¶é—´ï¼Œæ ¹æ®ä¸šåŠ¡è°ƒæ•´` |

### 8.4 é’ˆå¯¹ä¸åŒä¸šåŠ¡çš„è¶…æ—¶é…ç½®


**ğŸ¯ ä¸šåŠ¡åœºæ™¯é…ç½®ç¤ºä¾‹**ï¼š

```nginx
# å¿«é€ŸAPIæ¥å£
location /api/quick/ {
    proxy_pass http://api_servers;
    proxy_connect_timeout 5s;
    proxy_send_timeout 10s;
    proxy_read_timeout 10s;
}

# æ–‡ä»¶ä¸Šä¼ æ¥å£
location /api/upload/ {
    proxy_pass http://upload_servers;
    proxy_connect_timeout 10s;
    proxy_send_timeout 300s;  # ä¸Šä¼ éœ€è¦æ›´é•¿æ—¶é—´
    proxy_read_timeout 300s;
    
    # ä¸Šä¼ ç›¸å…³é…ç½®
    client_max_body_size 100m;
}

# æŠ¥è¡¨ç”Ÿæˆæ¥å£
location /api/report/ {
    proxy_pass http://report_servers;
    proxy_connect_timeout 10s;
    proxy_send_timeout 60s;
    proxy_read_timeout 600s;  # æŠ¥è¡¨ç”Ÿæˆå¯èƒ½å¾ˆæ…¢
}
```

---

## 9. ğŸ”„ æ•…éšœè½¬ç§»ä¸å¤‡ç”¨æœåŠ¡å™¨


### 9.1 æ•…éšœè½¬ç§»æœºåˆ¶


**åŸºæœ¬åŸç†**ï¼šå½“ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ï¼ŒNginxè‡ªåŠ¨å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨æˆ–å¤‡ç”¨æœåŠ¡å™¨ã€‚

### 9.2 next_upstreamé…ç½®


**ğŸ”§ æ•…éšœè½¬ç§»é…ç½®**ï¼š
```nginx
location /api/ {
    proxy_pass http://backend_pool;
    
    # å®šä¹‰ä»€ä¹ˆæƒ…å†µä¸‹å°è¯•ä¸‹ä¸€ä¸ªæœåŠ¡å™¨
    proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
    
    # æœ€å¤§å°è¯•æ¬¡æ•°
    proxy_next_upstream_tries 3;
    
    # æœ€å¤§å°è¯•æ—¶é—´
    proxy_next_upstream_timeout 10s;
}
```

**proxy_next_upstreamå‚æ•°è¯´æ˜**ï¼š
- **error**ï¼šè¿æ¥å‡ºé”™
- **timeout**ï¼šè¿æ¥è¶…æ—¶
- **invalid_header**ï¼šå“åº”å¤´æ— æ•ˆ
- **http_5xx**ï¼šè¿”å›5xxé”™è¯¯ç 

### 9.3 å¤‡ç”¨æœåŠ¡å™¨é…ç½®


**ğŸ’¾ å¤‡ç”¨æœåŠ¡å™¨ç­–ç•¥**ï¼š
```nginx
upstream backend_pool {
    # ä¸»è¦æœåŠ¡å™¨
    server 192.168.1.101 max_fails=2 fail_timeout=10s;
    server 192.168.1.102 max_fails=2 fail_timeout=10s;
    
    # å¤‡ç”¨æœåŠ¡å™¨ï¼ˆåªæœ‰ä¸»æœåŠ¡å™¨éƒ½æ•…éšœæ—¶æ‰ä½¿ç”¨ï¼‰
    server 192.168.1.103 backup;
    server 192.168.1.104 backup;
}
```

### 9.4 æ•…éšœè½¬ç§»å®æˆ˜åœºæ™¯


**ğŸ“‹ å®Œæ•´æ•…éšœè½¬ç§»é…ç½®**ï¼š
```nginx
upstream web_cluster {
    # ä¸»åŠ›æœåŠ¡å™¨ç»„
    server 10.0.1.10:8080 weight=3 max_fails=2 fail_timeout=30s;
    server 10.0.1.11:8080 weight=3 max_fails=2 fail_timeout=30s;
    server 10.0.1.12:8080 weight=2 max_fails=2 fail_timeout=30s;
    
    # å¤‡ç”¨æœåŠ¡å™¨
    server 10.0.1.20:8080 backup;
    
    # è¿æ¥ä¿æŒ
    keepalive 16;
}

location / {
    proxy_pass http://web_cluster;
    
    # æ•…éšœè½¬ç§»æ¡ä»¶
    proxy_next_upstream error timeout invalid_header 
                        http_500 http_502 http_503 http_504;
    
    # æ•…éšœè½¬ç§»é™åˆ¶
    proxy_next_upstream_tries 2;
    proxy_next_upstream_timeout 5s;
    
    # åŸºç¡€ä»£ç†é…ç½®
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    
    # è¶…æ—¶é…ç½®
    proxy_connect_timeout 5s;
    proxy_send_timeout 10s;
    proxy_read_timeout 30s;
}
```

---

## 10. ğŸ› ï¸ å®æˆ˜é…ç½®ç¤ºä¾‹


### 10.1 å®Œæ•´ç”Ÿäº§ç¯å¢ƒé…ç½®


**ğŸ­ ç”Ÿäº§çº§åå‘ä»£ç†é…ç½®**ï¼š
```nginx
# upstreamå®šä¹‰
upstream api_backend {
    # ä¸»æœåŠ¡å™¨ç¾¤
    server 10.0.1.10:8080 weight=3 max_fails=2 fail_timeout=30s;
    server 10.0.1.11:8080 weight=3 max_fails=2 fail_timeout=30s;
    server 10.0.1.12:8080 weight=2 max_fails=2 fail_timeout=30s;
    
    # å¤‡ç”¨æœåŠ¡å™¨
    server 10.0.1.20:8080 backup;
    
    # ä¿æŒè¿æ¥
    keepalive 32;
    keepalive_requests 1000;
    keepalive_timeout 60s;
}

# ç¼“å­˜é…ç½®
proxy_cache_path /var/cache/nginx/api 
                 levels=1:2 
                 keys_zone=api_cache:100m 
                 max_size=5g 
                 inactive=120m;

server {
    listen 80;
    server_name api.example.com;
    
    # APIä»£ç†é…ç½®
    location /api/ {
        # åŸºç¡€ä»£ç†
        proxy_pass http://api_backend;
        
        # è¯·æ±‚å¤´è®¾ç½®
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Request-ID $request_id;
        
        # è¶…æ—¶é…ç½®
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
        
        # æ•…éšœè½¬ç§»
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
        proxy_next_upstream_tries 2;
        proxy_next_upstream_timeout 10s;
        
        # ç¼“å­˜é…ç½®
        proxy_cache api_cache;
        proxy_cache_valid 200 302 5m;
        proxy_cache_valid 404 1m;
        proxy_cache_key $scheme$proxy_host$uri$is_args$args;
        proxy_cache_bypass $cookie_nocache $arg_nocache;
        
        # å“åº”å¤´
        add_header X-Cache-Status $upstream_cache_status;
        add_header X-Response-Time $upstream_response_time;
    }
    
    # å¥åº·æ£€æŸ¥æ¥å£
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
    
    # é™æ€æ–‡ä»¶ç›´æ¥å¤„ç†
    location /static/ {
        alias /var/www/static/;
        expires 1d;
        add_header Cache-Control "public, immutable";
    }
}
```

### 10.2 å¾®æœåŠ¡æ¶æ„é…ç½®


**ğŸ”— å¾®æœåŠ¡ä»£ç†é…ç½®**ï¼š
```nginx
# ç”¨æˆ·æœåŠ¡
upstream user_service {
    server 10.0.1.10:8001;
    server 10.0.1.11:8001;
}

# è®¢å•æœåŠ¡
upstream order_service {
    server 10.0.1.20:8002;
    server 10.0.1.21:8002;
}

# æ”¯ä»˜æœåŠ¡
upstream payment_service {
    server 10.0.1.30:8003;
    server 10.0.1.31:8003;
}

server {
    listen 80;
    server_name gateway.example.com;
    
    # ç”¨æˆ·ç›¸å…³API
    location /api/users/ {
        proxy_pass http://user_service/;
        include /etc/nginx/proxy_params;
    }
    
    # è®¢å•ç›¸å…³API
    location /api/orders/ {
        proxy_pass http://order_service/;
        include /etc/nginx/proxy_params;
    }
    
    # æ”¯ä»˜ç›¸å…³API
    location /api/payments/ {
        proxy_pass http://payment_service/;
        include /etc/nginx/proxy_params;
        
        # æ”¯ä»˜æ¥å£ç‰¹æ®Šé…ç½®
        proxy_read_timeout 120s;  # æ”¯ä»˜å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´
    }
}
```

### 10.3 å…¬å…±é…ç½®æ–‡ä»¶


**ğŸ“„ /etc/nginx/proxy_params**ï¼š
```nginx
# é€šç”¨ä»£ç†å‚æ•°é…ç½®æ–‡ä»¶
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;

proxy_connect_timeout 10s;
proxy_send_timeout 30s;
proxy_read_timeout 30s;

proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
proxy_next_upstream_tries 2;
proxy_next_upstream_timeout 10s;

proxy_buffering on;
proxy_buffer_size 4k;
proxy_buffers 8 4k;
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åå‘ä»£ç†æœ¬è´¨ï¼šNginxä½œä¸ºä¸­è½¬ç«™ï¼Œè½¬å‘å®¢æˆ·ç«¯è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨
ğŸ”¸ proxy_passè§„åˆ™ï¼šURLè·¯å¾„å¤„ç†çš„æ–œæ è§„åˆ™è¦ç‰¢è®°
ğŸ”¸ upstreamæœºåˆ¶ï¼šå®šä¹‰åç«¯æœåŠ¡å™¨æ± ï¼Œå®ç°è´Ÿè½½å‡è¡¡
ğŸ”¸ è¯·æ±‚å¤´å¤„ç†ï¼šä¿æŒå®¢æˆ·ç«¯çœŸå®ä¿¡æ¯çš„ä¼ é€’
ğŸ”¸ è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šè½®è¯¢ã€åŠ æƒã€IPå“ˆå¸Œã€æœ€å°‘è¿æ¥çš„é€‰æ‹©
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šè‡ªåŠ¨å‘ç°å’Œå¤„ç†æ•…éšœæœåŠ¡å™¨
ğŸ”¸ ç¼“å­˜æœºåˆ¶ï¼šæå‡æ€§èƒ½ï¼Œå‡å°‘åç«¯å‹åŠ›
ğŸ”¸ è¶…æ—¶é…ç½®ï¼šå¹³è¡¡æ€§èƒ½å’Œç¨³å®šæ€§
ğŸ”¸ æ•…éšœè½¬ç§»ï¼šä¿è¯æœåŠ¡çš„é«˜å¯ç”¨æ€§
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ proxy_passè·¯å¾„å¤„ç†é€»è¾‘**
```
è®°å¿†æ–¹æ³•ï¼š
- æœ‰æ–œæ ï¼šæ›¿æ¢locationéƒ¨åˆ†
- æ— æ–œæ ï¼šä¿ç•™å®Œæ•´è·¯å¾„
- æŒ‡å®šè·¯å¾„ï¼šæŒ‰æŒ‡å®šè·¯å¾„æ›¿æ¢
```

**ğŸ”¹ è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©**
```
é€‰æ‹©æŒ‡å—ï¼š
- æœåŠ¡å™¨æ€§èƒ½ç›¸åŒ â†’ è½®è¯¢
- æœåŠ¡å™¨æ€§èƒ½ä¸åŒ â†’ åŠ æƒè½®è¯¢  
- éœ€è¦ä¼šè¯ä¿æŒ â†’ IPå“ˆå¸Œ
- è¯·æ±‚å¤„ç†æ—¶é—´å·®å¼‚å¤§ â†’ æœ€å°‘è¿æ¥
```

**ğŸ”¹ è¶…æ—¶å‚æ•°è®¾ç½®åŸåˆ™**
```
è®¾ç½®åŸåˆ™ï¼š
- è¿æ¥è¶…æ—¶ï¼š5-30ç§’ï¼ˆç½‘ç»œè¿æ¥é€šå¸¸å¾ˆå¿«ï¼‰
- å‘é€è¶…æ—¶ï¼š30-60ç§’ï¼ˆæ ¹æ®è¯·æ±‚å¤§å°ï¼‰
- è¯»å–è¶…æ—¶ï¼š30-300ç§’ï¼ˆæ ¹æ®ä¸šåŠ¡å¤„ç†æ—¶é—´ï¼‰
```

### 11.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ“Š æ€§èƒ½æå‡**ï¼š
- é€šè¿‡è´Ÿè½½å‡è¡¡æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
- é€šè¿‡ç¼“å­˜å‡å°‘åç«¯å‹åŠ›
- é€šè¿‡è¿æ¥ä¿æŒå‡å°‘è¿æ¥å¼€é”€

**ğŸ›¡ï¸ ç¨³å®šæ€§ä¿éšœ**ï¼š
- é€šè¿‡å¥åº·æ£€æŸ¥è‡ªåŠ¨å¤„ç†æ•…éšœ
- é€šè¿‡æ•…éšœè½¬ç§»ä¿è¯æœåŠ¡è¿ç»­æ€§
- é€šè¿‡è¶…æ—¶æ§åˆ¶é¿å…èµ„æºè€—å°½

**ğŸ”§ è¿ç»´ä¾¿åˆ©**ï¼š
- ç»Ÿä¸€å…¥å£ï¼Œä¾¿äºç®¡ç†
- çµæ´»çš„è·¯ç”±é…ç½®
- è¯¦ç»†çš„ç›‘æ§å’Œæ—¥å¿—

### 11.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ å¸¸è§é—®é¢˜é€ŸæŸ¥**ï¼š

| **é—®é¢˜** | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|
| **502é”™è¯¯** | `åç«¯æœåŠ¡å™¨æ— å“åº”` | `æ£€æŸ¥upstreamé…ç½®å’Œåç«¯æœåŠ¡` |
| **504é”™è¯¯** | `åç«¯å¤„ç†è¶…æ—¶` | `è°ƒæ•´proxy_read_timeout` |
| **è´Ÿè½½ä¸å‡** | `ç®—æ³•é€‰æ‹©ä¸å½“` | `ä½¿ç”¨åŠ æƒè½®è¯¢æˆ–æœ€å°‘è¿æ¥` |
| **ä¼šè¯ä¸¢å¤±** | `è¯·æ±‚åˆ°äº†ä¸åŒæœåŠ¡å™¨` | `ä½¿ç”¨ip_hashç®—æ³•` |
| **ç¼“å­˜ä¸ç”Ÿæ•ˆ** | `ç¼“å­˜é…ç½®é”™è¯¯` | `æ£€æŸ¥cache_keyå’Œcache_valid` |

**ğŸ¯ æœ€ä½³å®è·µå»ºè®®**ï¼š
- åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®åå†ä¸Šç”Ÿäº§
- å®šæœŸç›‘æ§åç«¯æœåŠ¡å™¨å¥åº·çŠ¶æ€
- æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´è¶…æ—¶å’Œç¼“å­˜å‚æ•°
- å»ºç«‹å®Œå–„çš„æ—¥å¿—å’Œç›‘æ§ä½“ç³»
- å‡†å¤‡æ•…éšœåº”æ€¥å¤„ç†æ–¹æ¡ˆ

**ğŸ’¡ è®°å¿†å£è¯€**ï¼š
```
åå‘ä»£ç†ä¸­è½¬ç«™ï¼Œproxy_passå®šæ–¹å‘
upstreamæœåŠ¡å™¨æ± ï¼Œè´Ÿè½½å‡è¡¡æœ‰ç®—æ³•
è¯·æ±‚å¤´è¦ä¼ çœŸå®ï¼Œç¼“å­˜æé€Ÿå‡å‹åŠ›
è¶…æ—¶å‚æ•°éœ€è°ƒä¼˜ï¼Œæ•…éšœè½¬ç§»ä¿ç¨³å®š
```