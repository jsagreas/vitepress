---
title: 12ã€WebæœåŠ¡å®‰å…¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [WebæœåŠ¡å®‰å…¨æ¦‚è¿°](#1-webæœåŠ¡å®‰å…¨æ¦‚è¿°)
2. [è®¿é—®æ§åˆ¶ä¸IPç™½åå•](#2-è®¿é—®æ§åˆ¶ä¸ipç™½åå•)
3. [ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†](#3-ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†)
4. [DDoSæ”»å‡»é˜²æŠ¤é…ç½®](#4-ddosæ”»å‡»é˜²æŠ¤é…ç½®)
5. [æœåŠ¡å™¨ä¿¡æ¯å®‰å…¨éšè—](#5-æœåŠ¡å™¨ä¿¡æ¯å®‰å…¨éšè—)
6. [HTTPå®‰å…¨å¤´é…ç½®](#6-httpå®‰å…¨å¤´é…ç½®)
7. [æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ§åˆ¶](#7-æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ§åˆ¶)
8. [ç›®å½•éå†é˜²æŠ¤æœºåˆ¶](#8-ç›®å½•éå†é˜²æŠ¤æœºåˆ¶)
9. [SQLæ³¨å…¥åŸºç¡€é˜²æŠ¤](#9-sqlæ³¨å…¥åŸºç¡€é˜²æŠ¤)
10. [å®‰å…¨é…ç½®æœ€ä½³å®è·µ](#10-å®‰å…¨é…ç½®æœ€ä½³å®è·µ)

---

## 1. ğŸ›¡ï¸ WebæœåŠ¡å®‰å…¨æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯WebæœåŠ¡å®‰å…¨


**ç®€å•ç†è§£**ï¼šå°±åƒç»™ä½ å®¶è£…é˜²ç›—é—¨ã€ç›‘æ§æ‘„åƒå¤´ä¸€æ ·ï¼ŒWebæœåŠ¡å®‰å…¨å°±æ˜¯ç»™ç½‘ç«™æœåŠ¡å™¨è£…å„ç§"å®‰å…¨è®¾å¤‡"ã€‚

```
ä¼ ç»Ÿæˆ¿å±‹å®‰å…¨          WebæœåŠ¡å®‰å…¨
     é—¨é”      â†’      ç”¨æˆ·è®¤è¯
     ç›‘æ§      â†’      è®¿é—®æ—¥å¿—
   é˜²ç›—é—¨      â†’      é˜²ç«å¢™
   é—¨ç¦ç³»ç»Ÿ    â†’      IPç™½åå•
```

**æ ¸å¿ƒç›®æ ‡**ï¼š
- ğŸ”’ **æ§åˆ¶è®¿é—®** - åªè®©è¯¥è¿›æ¥çš„äººè¿›æ¥
- ğŸ›¡ï¸ **é˜²å¾¡æ”»å‡»** - æŒ¡ä½å„ç§æ¶æ„æ”»å‡»
- ğŸ‘ï¸ **ç›‘æ§è®°å½•** - è®°å½•è°æ¥è¿‡ï¼Œåšäº†ä»€ä¹ˆ
- ğŸ” **ä¿æŠ¤æ•°æ®** - ç¡®ä¿æ•æ„Ÿä¿¡æ¯ä¸æ³„éœ²

### 1.2 å¸¸è§Webå®‰å…¨å¨èƒ


```
å¨èƒç±»å‹          å½±å“ç¨‹åº¦          é˜²æŠ¤éš¾åº¦
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æš´åŠ›ç ´è§£          ä¸­ç­‰              ç®€å•
DDoSæ”»å‡»         ä¸¥é‡              ä¸­ç­‰  
SQLæ³¨å…¥          ä¸¥é‡              ä¸­ç­‰
ç›®å½•éå†          ä¸­ç­‰              ç®€å•
æ–‡ä»¶ä¸Šä¼ æ¼æ´      ä¸¥é‡              ä¸­ç­‰
XSSæ”»å‡»          ä¸­ç­‰              å¤æ‚
```

---

## 2. ğŸšª è®¿é—®æ§åˆ¶ä¸IPç™½åå•


### 2.1 è®¿é—®æ§åˆ¶åŸºæœ¬æ¦‚å¿µ


**é€šä¿—è§£é‡Š**ï¼šè®¿é—®æ§åˆ¶å°±åƒå°åŒºé—¨ç¦ç³»ç»Ÿï¼Œå†³å®šè°èƒ½è¿›æ¥ï¼Œè°ä¸èƒ½è¿›æ¥ã€‚

**Nginxè®¿é—®æ§åˆ¶**ï¼š
```nginx
# åŸºæœ¬è®¿é—®æ§åˆ¶
server {
    listen 80;
    server_name example.com;
    
    # å…è®¸ç‰¹å®šIPè®¿é—®
    location /admin {
        allow 192.168.1.0/24;    # å…è®¸å±€åŸŸç½‘
        allow 123.45.67.89;       # å…è®¸ç‰¹å®šIP
        deny all;                 # æ‹’ç»å…¶ä»–æ‰€æœ‰IP
    }
    
    # æ‹’ç»ç‰¹å®šIP
    location / {
        deny 10.0.0.1;           # æ‹’ç»ç‰¹å®šIP
        allow all;               # å…è®¸å…¶ä»–æ‰€æœ‰IP
    }
}
```

**Apacheè®¿é—®æ§åˆ¶**ï¼š
```apache
# .htaccessæ–‡ä»¶ä¸­é…ç½®
<Directory "/var/www/html/admin">
    # Apache 2.4è¯­æ³•
    Require ip 192.168.1
    Require ip 123.45.67.89
    Require not ip 10.0.0.1
</Directory>

# ä¼ ç»Ÿè¯­æ³•ï¼ˆApache 2.2ï¼‰
<Directory "/var/www/html/admin">
    Order allow,deny
    Allow from 192.168.1.0/24
    Allow from 123.45.67.89
    Deny from 10.0.0.1
</Directory>
```

### 2.2 IPç™½åå•å®æˆ˜é…ç½®


**åœºæ™¯ç¤ºä¾‹**ï¼šåªå…è®¸å…¬å¸IPå’Œç‰¹å®šåˆä½œä¼™ä¼´è®¿é—®ç®¡ç†åå°

```nginx
# /etc/nginx/conf.d/whitelist.conf
geo $allowed_ip {
    default 0;
    192.168.1.0/24    1;    # å…¬å¸å†…ç½‘
    203.208.60.0/24   1;    # åˆä½œä¼™ä¼´A
    220.181.38.0/24   1;    # åˆä½œä¼™ä¼´B
    123.45.67.89      1;    # æŒ‡å®šç®¡ç†å‘˜IP
}

server {
    listen 80;
    server_name admin.example.com;
    
    # æ£€æŸ¥IPç™½åå•
    if ($allowed_ip = 0) {
        return 403;
    }
    
    location / {
        root /var/www/admin;
        index index.html;
    }
}
```

### 2.3 åŠ¨æ€IPç®¡ç†


**é—®é¢˜**ï¼šç®¡ç†å‘˜IPç»å¸¸å˜åŒ–æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ1**ï¼šåŸºäºåœ°ç†ä½ç½®é™åˆ¶
```nginx
# ä½¿ç”¨GeoIPæ¨¡å—
http {
    geoip_country /usr/share/GeoIP/GeoIP.dat;
    
    map $geoip_country_code $allowed_country {
        default no;
        CN yes;    # åªå…è®¸ä¸­å›½IP
        US yes;    # å…è®¸ç¾å›½IP
    }
    
    server {
        if ($allowed_country = no) {
            return 403;
        }
    }
}
```

**è§£å†³æ–¹æ¡ˆ2**ï¼šåŸºäºæ—¶é—´çš„è®¿é—®æ§åˆ¶
```nginx
# å·¥ä½œæ—¶é—´è®¿é—®é™åˆ¶
map $time_iso8601 $denied_time {
    default 0;
    "~T([01][0-9]|2[0-3]):" 1;  # 00:00-23:59éƒ½å…è®¸
    "~T(0[0-8]|1[8-9]|2[0-3]):" 1;  # åªåœ¨9-17ç‚¹å…è®¸
}

server {
    if ($denied_time) {
        return 403 "Access denied outside business hours";
    }
}
```

---

## 3. ğŸ” ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†


### 3.1 HTTPåŸºç¡€è®¤è¯


**åŸç†è§£é‡Š**ï¼šå°±åƒé“¶è¡Œå–æ¬¾æœºè¾“å…¥å¯†ç ï¼Œæµè§ˆå™¨ä¼šå¼¹å‡ºç”¨æˆ·åå¯†ç æ¡†ã€‚

**NginxåŸºç¡€è®¤è¯é…ç½®**ï¼š
```bash
# 1. åˆ›å»ºå¯†ç æ–‡ä»¶
htpasswd -c /etc/nginx/.htpasswd admin
# è¾“å…¥å¯†ç ï¼šadmin123

# 2. æ·»åŠ æ›´å¤šç”¨æˆ·
htpasswd /etc/nginx/.htpasswd user1
htpasswd /etc/nginx/.htpasswd user2
```

```nginx
# Nginxé…ç½®
server {
    listen 80;
    server_name secure.example.com;
    
    location /admin {
        auth_basic "ç®¡ç†å‘˜åŒºåŸŸ";
        auth_basic_user_file /etc/nginx/.htpasswd;
        
        root /var/www/admin;
        index index.html;
    }
    
    # ä¸åŒç›®å½•ä¸åŒæƒé™
    location /api {
        auth_basic "APIè®¿é—®";
        auth_basic_user_file /etc/nginx/.htpasswd_api;
        
        proxy_pass http://backend;
    }
}
```

### 3.2 Apacheè®¤è¯é…ç½®


```apache
# è™šæ‹Ÿä¸»æœºé…ç½®
<VirtualHost *:80>
    ServerName secure.example.com
    DocumentRoot /var/www/html
    
    <Directory "/var/www/html/admin">
        AuthType Basic
        AuthName "ç®¡ç†åŒºåŸŸ - è¯·è¾“å…¥ç”¨æˆ·åå¯†ç "
        AuthUserFile /etc/apache2/.htpasswd
        Require valid-user
    </Directory>
    
    # ç”¨æˆ·ç»„è®¤è¯
    <Directory "/var/www/html/staff">
        AuthType Basic
        AuthName "å‘˜å·¥åŒºåŸŸ"
        AuthUserFile /etc/apache2/.htpasswd
        AuthGroupFile /etc/apache2/.htgroup
        Require group staff
    </Directory>
</VirtualHost>
```

**ç”¨æˆ·ç»„æ–‡ä»¶ç¤ºä¾‹**ï¼š
```bash
# /etc/apache2/.htgroup
admin: alice bob
staff: charlie david alice
guests: eve frank
```

### 3.3 é«˜çº§è®¤è¯æœºåˆ¶


**åŸºäºå®¢æˆ·ç«¯è¯ä¹¦çš„è®¤è¯**ï¼š
```nginx
server {
    listen 443 ssl;
    server_name secure.example.com;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/ssl/certs/server.crt;
    ssl_certificate_key /etc/ssl/private/server.key;
    
    # å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯
    ssl_client_certificate /etc/ssl/certs/ca.crt;
    ssl_verify_client on;
    
    location / {
        # åªæœ‰æŒæœ‰æœ‰æ•ˆå®¢æˆ·ç«¯è¯ä¹¦çš„ç”¨æˆ·æ‰èƒ½è®¿é—®
        proxy_pass http://backend;
        proxy_set_header X-SSL-Client-Cert $ssl_client_cert;
    }
}
```

---

## 4. ğŸ›¡ï¸ DDoSæ”»å‡»é˜²æŠ¤é…ç½®


### 4.1 DDoSæ”»å‡»åŸºæœ¬åŸç†


**ç®€å•ç†è§£**ï¼šå°±åƒå¾ˆå¤šäººåŒæ—¶å¾€ä¸€ä¸ªå°é—¨é‡ŒæŒ¤ï¼ŒæŠŠé—¨å µæ­»äº†ï¼Œæ­£å¸¸äººä¹Ÿè¿›ä¸å»ã€‚

```
æ­£å¸¸è®¿é—®ï¼š          DDoSæ”»å‡»ï¼š
ç”¨æˆ·A â†’ æœåŠ¡å™¨      æ”»å‡»è€…1 â†˜
ç”¨æˆ·B â†’ æœåŠ¡å™¨      æ”»å‡»è€…2 â†’ æœåŠ¡å™¨ï¼ˆç˜«ç—ªï¼‰
ç”¨æˆ·C â†’ æœåŠ¡å™¨      æ”»å‡»è€…3 â†—
                   ... æˆåƒä¸Šä¸‡ä¸ªæ”»å‡»è€…
```

### 4.2 è¿æ¥é™åˆ¶é…ç½®


**Nginxè¿æ¥é™åˆ¶**ï¼š
```nginx
http {
    # é™åˆ¶è¿æ¥æ•°
    limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m;
    limit_conn_zone $server_name zone=conn_limit_per_server:10m;
    
    # é™åˆ¶è¯·æ±‚é¢‘ç‡
    limit_req_zone $binary_remote_addr zone=req_limit_per_ip:10m rate=10r/s;
    
    server {
        listen 80;
        server_name example.com;
        
        # æ¯ä¸ªIPæœ€å¤š10ä¸ªè¿æ¥
        limit_conn conn_limit_per_ip 10;
        
        # æ•´ä¸ªæœåŠ¡å™¨æœ€å¤š1000ä¸ªè¿æ¥
        limit_conn conn_limit_per_server 1000;
        
        location / {
            # æ¯ä¸ªIPæ¯ç§’æœ€å¤š10ä¸ªè¯·æ±‚ï¼Œçªå‘æœ€å¤š20ä¸ª
            limit_req zone=req_limit_per_ip burst=20 nodelay;
            
            root /var/www/html;
            index index.html;
        }
        
        # APIæ¥å£æ›´ä¸¥æ ¼é™åˆ¶
        location /api/ {
            limit_req zone=req_limit_per_ip burst=5 nodelay;
            proxy_pass http://backend;
        }
    }
}
```

### 4.3 æ·±åº¦é˜²æŠ¤é…ç½®


**åˆ†å±‚é˜²æŠ¤ç­–ç•¥**ï¼š
```nginx
# æ›´ç²¾ç»†çš„é™æµé…ç½®
map $request_uri $request_uri_limit {
    ~*/login    login;
    ~*/api/     api;
    default     normal;
}

limit_req_zone $binary_remote_addr$request_uri_limit zone=mixed:10m rate=5r/s;

server {
    location / {
        # æ ¹æ®ä¸åŒæ¥å£è®¾ç½®ä¸åŒé™åˆ¶
        limit_req zone=mixed burst=10;
        
        # æ£€æµ‹User-Agent
        if ($http_user_agent ~* (bot|crawler|spider)) {
            return 403 "Bots not allowed";
        }
        
        # æ£€æµ‹ç©ºRefererçš„POSTè¯·æ±‚
        if ($request_method = POST) {
            if ($http_referer = "") {
                return 403 "Invalid request";
            }
        }
        
        proxy_pass http://backend;
    }
}
```

### 4.4 fail2bané›†æˆé˜²æŠ¤


**å®‰è£…é…ç½®fail2ban**ï¼š
```bash
# å®‰è£…fail2ban
sudo apt-get install fail2ban

# åˆ›å»ºnginxé…ç½®
sudo nano /etc/fail2ban/jail.local
```

```ini
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
action = iptables-multiport[name=NoAuthFailures, port="http,https"]
logpath = /var/log/nginx/error.log
bantime = 600
maxretry = 6

[nginx-dos]
enabled = true
filter = nginx-dos
action = iptables-multiport[name=nginx-dos, port="http,https"]
logpath = /var/log/nginx/access.log
bantime = 600
maxretry = 250
findtime = 60
```

---

## 5. ğŸ•µï¸ æœåŠ¡å™¨ä¿¡æ¯å®‰å…¨éšè—


### 5.1 éšè—æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯


**ä¸ºä»€ä¹ˆè¦éšè—**ï¼šå°±åƒä¸è¦åœ¨é—¨å£è´´"æˆ‘å®¶ç”¨çš„æ˜¯XXç‰Œé˜²ç›—é—¨"ï¼Œé¿å…æš´éœ²æŠ€æœ¯ç»†èŠ‚ç»™æ”»å‡»è€…ã€‚

**Nginxç‰ˆæœ¬éšè—**ï¼š
```nginx
http {
    # éšè—Nginxç‰ˆæœ¬å·
    server_tokens off;
    
    # è‡ªå®šä¹‰Serverå¤´
    more_set_headers "Server: MyWebServer";
    
    server {
        listen 80;
        server_name example.com;
        
        location / {
            # ç§»é™¤æˆ–ä¿®æ”¹å“åº”å¤´
            more_clear_headers "X-Powered-By";
            more_set_headers "X-Frame-Options: SAMEORIGIN";
            
            root /var/www/html;
        }
    }
}
```

**Apacheç‰ˆæœ¬éšè—**ï¼š
```apache
# /etc/apache2/conf-available/security.conf
ServerTokens Prod
ServerSignature Off

# éšè—Apacheç‰ˆæœ¬å’Œæ“ä½œç³»ç»Ÿä¿¡æ¯
Header always unset "X-Powered-By"
Header always set "Server" "WebServer"
```

### 5.2 é”™è¯¯é¡µé¢å®‰å…¨å¤„ç†


**é—®é¢˜**ï¼šé»˜è®¤é”™è¯¯é¡µé¢ä¼šæš´éœ²æœåŠ¡å™¨ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```nginx
server {
    listen 80;
    server_name example.com;
    
    # è‡ªå®šä¹‰é”™è¯¯é¡µé¢
    error_page 403 /error/403.html;
    error_page 404 /error/404.html;
    error_page 500 502 503 504 /error/50x.html;
    
    location = /error/403.html {
        root /var/www/error;
        internal;
    }
    
    location = /error/404.html {
        root /var/www/error;
        internal;
    }
    
    location = /error/50x.html {
        root /var/www/error;
        internal;
    }
    
    # éšè—æ•æ„Ÿç›®å½•
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # éšè—å¤‡ä»½æ–‡ä»¶
    location ~ \.(bak|backup|old|tmp)$ {
        deny all;
    }
}
```

---

## 6. ğŸ”’ HTTPå®‰å…¨å¤´é…ç½®


### 6.1 é‡è¦å®‰å…¨å¤´è§£é‡Š


**é€šä¿—ç†è§£**ï¼šå®‰å…¨å¤´å°±åƒç»™ç½‘é¡µè´´ä¸Šå„ç§"å®‰å…¨æ ‡ç­¾"ï¼Œå‘Šè¯‰æµè§ˆå™¨å¦‚ä½•å®‰å…¨å¤„ç†è¿™ä¸ªç½‘é¡µã€‚

| å®‰å…¨å¤´ | ä½œç”¨ | ç”Ÿæ´»æ¯”å–» |
|--------|------|----------|
| `X-Frame-Options` | é˜²æ­¢ç½‘é¡µè¢«åµŒå…¥iframe | é˜²æ­¢åˆ«äººæŠŠä½ å®¶ç…§ç‰‡è´´åˆ°å‡æˆ¿äº§å¹¿å‘Šé‡Œ |
| `X-XSS-Protection` | é˜²æ­¢XSSæ”»å‡» | é˜²æ­¢æœ‰æ¯’é£Ÿç‰©æ··å…¥ |
| `X-Content-Type-Options` | é˜²æ­¢MIMEç±»å‹æ··æ·† | ç¡®ä¿è¯å“åŒ…è£…ä¸Šçš„è¯´æ˜å‡†ç¡® |
| `Strict-Transport-Security` | å¼ºåˆ¶HTTPS | è¦æ±‚æ‰€æœ‰é€šä¿¡éƒ½ç”¨åŠ å¯†ç”µè¯ |

### 6.2 Nginxå®‰å…¨å¤´é…ç½®


```nginx
server {
    listen 443 ssl http2;
    server_name secure.example.com;
    
    # SSLé…ç½®
    ssl_certificate /etc/ssl/certs/example.com.crt;
    ssl_certificate_key /etc/ssl/private/example.com.key;
    
    location / {
        # åŸºç¡€å®‰å…¨å¤´
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Referrer-Policy "strict-origin-when-cross-origin" always;
        
        # HTTPSå¼ºåˆ¶
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
        
        # å†…å®¹å®‰å…¨ç­–ç•¥
        add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'" always;
        
        # æƒé™ç­–ç•¥
        add_header Permissions-Policy "camera=(), microphone=(), geolocation=()" always;
        
        root /var/www/html;
        index index.html;
    }
}
```

### 6.3 å†…å®¹å®‰å…¨ç­–ç•¥è¯¦è§£


**CSPç­–ç•¥ç¤ºä¾‹**ï¼š
```nginx
# ä¸¥æ ¼çš„CSPç­–ç•¥
add_header Content-Security-Policy "
    default-src 'self';
    script-src 'self' https://cdnjs.cloudflare.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: https:;
    connect-src 'self' https://api.example.com;
    frame-ancestors 'none';
    base-uri 'self';
    form-action 'self'
" always;

# æ¸è¿›å¼CSPç­–ç•¥ï¼ˆç”¨äºå·²æœ‰ç½‘ç«™ï¼‰
add_header Content-Security-Policy-Report-Only "
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval';
    report-uri /csp-report
" always;
```

---

## 7. ğŸ“¤ æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ§åˆ¶


### 7.1 æ–‡ä»¶ä¸Šä¼ é£é™©


**å±é™©ç¤ºä¾‹**ï¼š
```
ç”¨æˆ·ä¸Šä¼  evil.php â†’ æœåŠ¡å™¨æ‰§è¡Œ â†’ æœåŠ¡å™¨è¢«æ§åˆ¶
ç”¨æˆ·ä¸Šä¼  huge.zip â†’ æœåŠ¡å™¨ç£ç›˜æ»¡ â†’ æœåŠ¡å™¨å®•æœº
ç”¨æˆ·ä¸Šä¼  virus.exe â†’ å…¶ä»–ç”¨æˆ·ä¸‹è½½ â†’ ä¼ æ’­ç—…æ¯’
```

### 7.2 Nginxæ–‡ä»¶ä¸Šä¼ é™åˆ¶


```nginx
server {
    listen 80;
    server_name upload.example.com;
    
    # æ–‡ä»¶å¤§å°é™åˆ¶
    client_max_body_size 10M;
    client_body_buffer_size 128k;
    client_body_timeout 60s;
    
    location /upload {
        # åªå…è®¸POSTæ–¹æ³•
        limit_except POST {
            deny all;
        }
        
        # é™åˆ¶æ–‡ä»¶ç±»å‹
        location ~ \.(php|jsp|asp|sh|py|pl)$ {
            deny all;
        }
        
        # ä¸Šä¼ ç›®å½•é…ç½®
        root /var/www/uploads;
        
        # ç¦æ­¢æ‰§è¡Œè„šæœ¬
        location ~ \.php$ {
            deny all;
        }
    }
    
    # ä¸‹è½½ç›®å½• - ç¦æ­¢æ‰§è¡Œ
    location /downloads {
        root /var/www/public;
        
        # å¼ºåˆ¶ä¸‹è½½ï¼Œä¸åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œ
        add_header Content-Disposition "attachment";
        
        # ç¦æ­¢è„šæœ¬æ‰§è¡Œ
        location ~ \.(php|jsp|asp)$ {
            deny all;
        }
    }
}
```

### 7.3 Apacheæ–‡ä»¶ä¸Šä¼ å®‰å…¨


```apache
<VirtualHost *:80>
    ServerName upload.example.com
    DocumentRoot /var/www/uploads
    
    # é™åˆ¶ä¸Šä¼ å¤§å°
    LimitRequestBody 10485760  # 10MB
    
    <Directory "/var/www/uploads">
        # ç¦æ­¢è„šæœ¬æ‰§è¡Œ
        <Files "*.php">
            Require all denied
        </Files>
        
        <Files "*.jsp">
            Require all denied
        </Files>
        
        # å¼ºåˆ¶ä¸‹è½½ç‰¹å®šæ–‡ä»¶ç±»å‹
        <FilesMatch "\.(zip|rar|exe|dmg)$">
            Header set Content-Disposition "attachment"
        </FilesMatch>
        
        # ç¦æ­¢.htaccessè¢«è®¿é—®
        <Files ".htaccess">
            Require all denied
        </Files>
    </Directory>
    
    # ä¸Šä¼ è„šæœ¬çš„å®‰å…¨é…ç½®
    <Directory "/var/www/cgi-bin/upload">
        Options ExecCGI
        AllowOverride None
        
        # åªå…è®¸ç‰¹å®šç”¨æˆ·ç»„è®¿é—®
        AuthType Basic
        AuthName "Upload Area"
        AuthUserFile /etc/apache2/.htpasswd
        Require group uploaders
    </Directory>
</VirtualHost>
```

### 7.4 æ–‡ä»¶ç±»å‹æ£€æµ‹


**PHPä¸Šä¼ æ£€æµ‹ç¤ºä¾‹**ï¼š
```php
<?php
// å®‰å…¨çš„æ–‡ä»¶ä¸Šä¼ å¤„ç†
function secureFileUpload($file) {
    // å…è®¸çš„æ–‡ä»¶ç±»å‹
    $allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
    $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'pdf'];
    
    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
    if (!in_array($file['type'], $allowedTypes)) {
        return "ä¸å…è®¸çš„æ–‡ä»¶ç±»å‹";
    }
    
    // æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
    $extension = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
    if (!in_array($extension, $allowedExtensions)) {
        return "ä¸å…è®¸çš„æ–‡ä»¶æ‰©å±•å";
    }
    
    // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ5MBé™åˆ¶ï¼‰
    if ($file['size'] > 5 * 1024 * 1024) {
        return "æ–‡ä»¶å¤ªå¤§";
    }
    
    // ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å
    $safeFileName = uniqid() . '.' . $extension;
    $uploadPath = '/var/www/uploads/' . $safeFileName;
    
    // ç§»åŠ¨æ–‡ä»¶åˆ°å®‰å…¨ç›®å½•
    if (move_uploaded_file($file['tmp_name'], $uploadPath)) {
        return "ä¸Šä¼ æˆåŠŸï¼š" . $safeFileName;
    } else {
        return "ä¸Šä¼ å¤±è´¥";
    }
}
?>
```

---

## 8. ğŸ—‚ï¸ ç›®å½•éå†é˜²æŠ¤æœºåˆ¶


### 8.1 ç›®å½•éå†æ”»å‡»åŸç†


**æ”»å‡»ç¤ºä¾‹**ï¼š
```
æ­£å¸¸è®¿é—®ï¼šhttp://example.com/files/document.pdf
æ¶æ„è®¿é—®ï¼šhttp://example.com/files/../../../etc/passwd
ç›®çš„ï¼šè·å–æœåŠ¡å™¨æ•æ„Ÿæ–‡ä»¶
```

### 8.2 Nginxç›®å½•é˜²æŠ¤


```nginx
server {
    listen 80;
    server_name example.com;
    
    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶å’Œç›®å½•
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~* \.(conf|log|sql|bak|backup|old)$ {
        deny all;
    }
    
    # ç¦æ­¢è®¿é—®ç³»ç»Ÿç›®å½•
    location ~ ^/(etc|var|usr|bin|boot|dev|proc|sys)/ {
        deny all;
    }
    
    # å®‰å…¨çš„æ–‡ä»¶è®¿é—®
    location /files/ {
        alias /var/www/public/files/;
        
        # é˜²æ­¢è·¯å¾„ç©¿è¶Š
        try_files $uri =404;
        
        # åªå…è®¸ç‰¹å®šæ–‡ä»¶ç±»å‹
        location ~* \.(pdf|doc|docx|xls|xlsx|ppt|pptx|txt|zip)$ {
            expires 1d;
            add_header Cache-Control "public, no-transform";
        }
        
        # æ‹’ç»å…¶ä»–æ–‡ä»¶ç±»å‹
        location ~* \.(php|sh|py|pl|exe)$ {
            deny all;
        }
    }
    
    # ç®¡ç†ç›®å½•ä¿æŠ¤
    location /admin/ {
        allow 192.168.1.0/24;
        deny all;
        
        # é¢å¤–çš„ç›®å½•åˆ—è¡¨ç¦ç”¨
        autoindex off;
        
        try_files $uri $uri/ =404;
    }
}
```

### 8.3 Apacheç›®å½•é˜²æŠ¤


```apache
<VirtualHost *:80>
    ServerName example.com
    DocumentRoot /var/www/html
    
    # å…¨å±€ç›®å½•ä¿æŠ¤
    <Directory />
        Options -Indexes -Includes -ExecCGI
        AllowOverride None
        Require all denied
    </Directory>
    
    <Directory "/var/www/html">
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
        
        # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
        <Files ".*">
            Require all denied
        </Files>
        
        # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
        <FilesMatch "\.(conf|log|sql|bak|backup|old)$">
            Require all denied
        </FilesMatch>
    </Directory>
    
    # å…¬å…±æ–‡ä»¶ä¸‹è½½ç›®å½•
    <Directory "/var/www/html/downloads">
        Options -Indexes -ExecCGI
        
        # åªå…è®¸ç‰¹å®šæ–‡ä»¶ç±»å‹
        <FilesMatch "\.(pdf|doc|docx|zip|txt)$">
            Require all granted
        </FilesMatch>
        
        # æ‹’ç»å¯æ‰§è¡Œæ–‡ä»¶
        <FilesMatch "\.(php|sh|py|pl|exe|jsp)$">
            Require all denied
        </FilesMatch>
    </Directory>
    
    # ç³»ç»Ÿç›®å½•ä¿æŠ¤
    <DirectoryMatch "^/(etc|var|usr|bin|boot|dev|proc|sys)">
        Require all denied
    </DirectoryMatch>
</VirtualHost>
```

---

## 9. ğŸ’‰ SQLæ³¨å…¥åŸºç¡€é˜²æŠ¤


### 9.1 SQLæ³¨å…¥æ”»å‡»åŸç†


**ç®€å•ç†è§£**ï¼šå°±åƒæœ‰äººåœ¨ä½ çš„å¯¹è¯ä¸­å·å·æ’å…¥æŒ‡ä»¤ï¼Œè®©ä½ åšä¸è¯¥åšçš„äº‹ã€‚

**æ”»å‡»ç¤ºä¾‹**ï¼š
```
æ­£å¸¸æŸ¥è¯¢ï¼šSELECT * FROM users WHERE username='admin'
æ¶æ„è¾“å…¥ï¼šadmin'; DROP TABLE users; --
ç»“æœæŸ¥è¯¢ï¼šSELECT * FROM users WHERE username='admin'; DROP TABLE users; --'
å±é™©åæœï¼šåˆ é™¤æ•´ä¸ªç”¨æˆ·è¡¨
```

### 9.2 WebæœåŠ¡å™¨å±‚é¢é˜²æŠ¤


**Nginxè¾“å…¥è¿‡æ»¤**ï¼š
```nginx
server {
    listen 80;
    server_name api.example.com;
    
    # SQLæ³¨å…¥å…³é”®è¯æ£€æµ‹
    if ($args ~* "(union|select|drop|delete|insert|update|exec|script)" ) {
        return 403 "SQL injection attempt detected";
    }
    
    if ($request_body ~* "(union|select|drop|delete|insert|update|exec)" ) {
        return 403 "SQL injection attempt detected";
    }
    
    # æ£€æµ‹å¸¸è§SQLæ³¨å…¥æ¨¡å¼
    location / {
        # æ£€æµ‹å•å¼•å·å’Œåˆ†å·ç»„åˆ
        if ($args ~* ".*[';].*") {
            return 403 "Invalid characters detected";
        }
        
        # æ£€æµ‹æ³¨é‡Šç¬¦å·
        if ($args ~* ".*(--|#|/\*).*") {
            return 403 "Comment injection detected";
        }
        
        proxy_pass http://backend;
        
        # è®¾ç½®è¯·æ±‚å¤´å¤§å°é™åˆ¶
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
    }
}
```

### 9.3 ModSecurityè§„åˆ™é…ç½®


**å®‰è£…ModSecurity**ï¼š
```bash
# Ubuntu/Debian
sudo apt-get install libapache2-mod-security2

# å¯ç”¨æ¨¡å—
sudo a2enmod security2
```

**åŸºç¡€è§„åˆ™é…ç½®**ï¼š
```apache
<IfModule mod_security2.c>
    # å¯ç”¨ModSecurity
    SecRuleEngine On
    
    # SQLæ³¨å…¥æ£€æµ‹è§„åˆ™
    SecRule ARGS "@detectSQLi" \
        "id:1001,phase:2,block,msg:'SQL Injection Attack Detected',\
         logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"
    
    # XSSæ”»å‡»æ£€æµ‹
    SecRule ARGS "@detectXSS" \
        "id:1002,phase:2,block,msg:'XSS Attack Detected',\
         logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"
    
    # ç¦æ­¢ç‰¹å®šå­—ç¬¦ç»„åˆ
    SecRule ARGS "@contains union" \
        "id:1003,phase:2,block,msg:'SQL Union Attack'"
    
    SecRule ARGS "@contains drop table" \
        "id:1004,phase:2,block,msg:'SQL Drop Table Attack'"
    
    # è¯·æ±‚ä½“æ£€æŸ¥
    SecRequestBodyAccess On
    SecRequestBodyLimit 1048576
    SecRequestBodyInMemoryLimit 131072
    
    # å“åº”ä½“æ£€æŸ¥
    SecResponseBodyAccess On
    SecResponseBodyMimeType text/plain text/html text/xml application/json
    SecResponseBodyLimit 1048576
    SecResponseBodyLimitAction Reject
</IfModule>
```

### 9.4 åº”ç”¨å±‚é˜²æŠ¤å»ºè®®


**PHPé˜²æŠ¤ç¤ºä¾‹**ï¼š
```php
<?php
// æ•°æ®åº“è¿æ¥å®‰å…¨é…ç½®
function getSecureDB() {
    $pdo = new PDO(
        'mysql:host=localhost;dbname=myapp;charset=utf8mb4',
        $username,
        $password,
        [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_EMULATE_PREPARES => false,  // ç¦ç”¨æ¨¡æ‹Ÿé¢„å¤„ç†
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        ]
    );
    return $pdo;
}

// å®‰å…¨çš„æŸ¥è¯¢å‡½æ•°
function secureQuery($sql, $params = []) {
    $pdo = getSecureDB();
    
    // è¾“å…¥éªŒè¯
    foreach ($params as $key => $value) {
        if (preg_match('/(union|select|drop|delete|insert|update|exec|script)/i', $value)) {
            throw new Exception("Invalid input detected");
        }
    }
    
    // ä½¿ç”¨é¢„å¤„ç†è¯­å¥
    $stmt = $pdo->prepare($sql);
    $stmt->execute($params);
    
    return $stmt->fetchAll();
}

// ä½¿ç”¨ç¤ºä¾‹
try {
    $users = secureQuery(
        "SELECT id, username, email FROM users WHERE department = ? AND status = ?",
        [$department, $status]
    );
} catch (Exception $e) {
    error_log("Security violation: " . $e->getMessage());
    die("Invalid request");
}
?>
```

---

## 10. âš¡ å®‰å…¨é…ç½®æœ€ä½³å®è·µ


### 10.1 å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•


**æœåŠ¡å™¨åŸºç¡€å®‰å…¨**ï¼š
- [ ] éšè—æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯
- [ ] é…ç½®è‡ªå®šä¹‰é”™è¯¯é¡µé¢
- [ ] ç¦ç”¨ä¸å¿…è¦çš„HTTPæ–¹æ³•
- [ ] è®¾ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´
- [ ] é…ç½®è¯·æ±‚å¤§å°é™åˆ¶

**è®¿é—®æ§åˆ¶**ï¼š
- [ ] å®ç°IPç™½åå•/é»‘åå•
- [ ] é…ç½®ç”¨æˆ·è®¤è¯
- [ ] è®¾ç½®ç›®å½•è®¿é—®æƒé™
- [ ] ç¦æ­¢æ•æ„Ÿæ–‡ä»¶è®¿é—®

**é˜²æ”»å‡»æªæ–½**ï¼š
- [ ] é…ç½®è¯·æ±‚é¢‘ç‡é™åˆ¶
- [ ] å¯ç”¨DDoSé˜²æŠ¤
- [ ] å®ç°SQLæ³¨å…¥æ£€æµ‹
- [ ] é…ç½®XSSé˜²æŠ¤
- [ ] è®¾ç½®æ–‡ä»¶ä¸Šä¼ é™åˆ¶

### 10.2 ç›‘æ§å’Œæ—¥å¿—é…ç½®


**Nginxå®‰å…¨æ—¥å¿—**ï¼š
```nginx
http {
    # è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼
    log_format security '$remote_addr - $remote_user [$time_local] '
                       '"$request" $status $body_bytes_sent '
                       '"$http_referer" "$http_user_agent" '
                       '"$request_time" "$upstream_response_time"';
    
    server {
        # è®°å½•æ‰€æœ‰è¯·æ±‚
        access_log /var/log/nginx/access.log security;
        
        # å•ç‹¬è®°å½•é”™è¯¯è¯·æ±‚
        error_log /var/log/nginx/error.log warn;
        
        # è®°å½•å®‰å…¨äº‹ä»¶
        location / {
            access_log /var/log/nginx/security.log security;
            
            # è®°å½•å¯ç–‘è¯·æ±‚
            if ($request_uri ~* "(union|select|script|alert)") {
                access_log /var/log/nginx/suspicious.log security;
            }
            
            proxy_pass http://backend;
        }
    }
}
```

### 10.3 å®šæœŸå®‰å…¨ç»´æŠ¤


**è‡ªåŠ¨åŒ–å®‰å…¨æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# security_check.sh - å®šæœŸå®‰å…¨æ£€æŸ¥è„šæœ¬

echo "=== å®‰å…¨æ£€æŸ¥æŠ¥å‘Š $(date) ==="

# 1. æ£€æŸ¥å¤±è´¥ç™»å½•å°è¯•
echo "æœ€è¿‘çš„å¤±è´¥ç™»å½•å°è¯•ï¼š"
grep "authentication failure" /var/log/auth.log | tail -10

# 2. æ£€æŸ¥å¯ç–‘ç½‘ç»œè¿æ¥
echo "å¯ç–‘çš„ç½‘ç»œè¿æ¥ï¼š"
netstat -an | grep :80 | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -nr | head -10

# 3. æ£€æŸ¥å¤§é‡è¯·æ±‚çš„IP
echo "é«˜é¢‘è®¿é—®IPï¼š"
awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10

# 4. æ£€æŸ¥é”™è¯¯æ—¥å¿—
echo "æœ€è¿‘çš„é”™è¯¯ï¼š"
tail -20 /var/log/nginx/error.log

# 5. æ£€æŸ¥ç£ç›˜ç©ºé—´
echo "ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
df -h | grep -E "(/$|/var/log)"

# 6. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
echo "ç³»ç»Ÿè´Ÿè½½ï¼š"
uptime

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

### 10.4 å®‰å…¨é…ç½®æ¨¡æ¿


**å®Œæ•´çš„å®‰å…¨Nginxé…ç½®æ¨¡æ¿**ï¼š
```nginx
# å®‰å…¨çš„Nginxé…ç½®æ¨¡æ¿
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
    use epoll;
}

http {
    # åŸºç¡€å®‰å…¨è®¾ç½®
    server_tokens off;
    client_max_body_size 10M;
    client_header_timeout 10s;
    client_body_timeout 10s;
    send_timeout 10s;
    
    # é™åˆ¶é…ç½®
    limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m;
    limit_req_zone $binary_remote_addr zone=req_limit_per_ip:10m rate=10r/s;
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # SSLé…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    server {
        listen 443 ssl http2;
        server_name secure.example.com;
        
        ssl_certificate /etc/ssl/certs/example.com.crt;
        ssl_certificate_key /etc/ssl/private/example.com.key;
        
        # è®¿é—®æ§åˆ¶
        limit_conn conn_limit_per_ip 10;
        limit_req zone=req_limit_per_ip burst=20 nodelay;
        
        # å®‰å…¨ä½ç½®é…ç½®
        location / {
            # SQLæ³¨å…¥æ£€æµ‹
            if ($args ~* "(union|select|drop|delete|insert|update)" ) {
                return 403;
            }
            
            # éšè—æ–‡ä»¶ä¿æŠ¤
            location ~ /\. {
                deny all;
            }
            
            # å¤‡ä»½æ–‡ä»¶ä¿æŠ¤
            location ~ \.(bak|backup|old|tmp)$ {
                deny all;
            }
            
            root /var/www/html;
            index index.html;
        }
    }
    
    # HTTPé‡å®šå‘åˆ°HTTPS
    server {
        listen 80;
        server_name secure.example.com;
        return 301 https://$server_name$request_uri;
    }
}
```

## ğŸ¯ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### å¿…é¡»æŒæ¡çš„å®‰å…¨é…ç½®


**ğŸ”¸ è®¿é—®æ§åˆ¶**ï¼šIPç™½åå•ã€ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç†
**ğŸ”¸ æ”»å‡»é˜²æŠ¤**ï¼šDDoSé˜²æŠ¤ã€SQLæ³¨å…¥æ£€æµ‹ã€XSSé˜²æŠ¤
**ğŸ”¸ ä¿¡æ¯éšè—**ï¼šç‰ˆæœ¬ä¿¡æ¯ã€é”™è¯¯é¡µé¢ã€æ•æ„Ÿæ–‡ä»¶
**ğŸ”¸ ä¼ è¾“å®‰å…¨**ï¼šHTTPSé…ç½®ã€å®‰å…¨å¤´è®¾ç½®
**ğŸ”¸ æ–‡ä»¶å®‰å…¨**ï¼šä¸Šä¼ é™åˆ¶ã€ç›®å½•ä¿æŠ¤ã€ç±»å‹æ£€æµ‹

### å®‰å…¨é…ç½®åŸåˆ™


```
å®‰å…¨ä¸‰è¦ç´ ï¼š
æœºå¯†æ€§ â†’ é˜²æ­¢ä¿¡æ¯æ³„éœ²
å®Œæ•´æ€§ â†’ é˜²æ­¢æ•°æ®ç¯¡æ”¹  
å¯ç”¨æ€§ â†’ é˜²æ­¢æœåŠ¡ä¸­æ–­

é˜²æŠ¤æ€è·¯ï¼š
é¢„é˜²ä¸ºä¸» â†’ æå‰é…ç½®é˜²æŠ¤è§„åˆ™
ç›‘æ§é¢„è­¦ â†’ å®æ—¶å‘ç°å®‰å…¨å¨èƒ
å¿«é€Ÿå“åº” â†’ åŠæ—¶å¤„ç†å®‰å…¨äº‹ä»¶
å®šæœŸç»´æŠ¤ â†’ æ›´æ–°å®‰å…¨é…ç½®å’Œè§„åˆ™
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Webå®‰å…¨å¦‚å®¶åº­é˜²æŠ¤ï¼Œéœ€è¦å¤šå±‚é˜²å¾¡
- è®¿é—®æ§åˆ¶æ˜¯ç¬¬ä¸€é“é˜²çº¿
- ä¿¡æ¯éšè—é¿å…æš´éœ²å¼±ç‚¹
- ç›‘æ§æ—¥å¿—åŠæ—¶å‘ç°é—®é¢˜
- å®šæœŸæ£€æŸ¥ä¿æŒå®‰å…¨æ°´å¹³