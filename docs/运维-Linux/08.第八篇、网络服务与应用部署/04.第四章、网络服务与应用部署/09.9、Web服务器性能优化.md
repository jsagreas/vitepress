---
title: 9ã€WebæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [WebæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°](#1-WebæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°)
2. [é™æ€èµ„æºç¼“å­˜é…ç½®](#2-é™æ€èµ„æºç¼“å­˜é…ç½®)
3. [Gzipå‹ç¼©é…ç½®](#3-Gzipå‹ç¼©é…ç½®)
4. [é•¿è¿æ¥keep-aliveé…ç½®](#4-é•¿è¿æ¥keep-aliveé…ç½®)
5. [å¹¶å‘è¿æ¥æ•°é™åˆ¶](#5-å¹¶å‘è¿æ¥æ•°é™åˆ¶)
6. [ç¼“å†²åŒºå¤§å°è°ƒä¼˜](#6-ç¼“å†²åŒºå¤§å°è°ƒä¼˜)
7. [æ–‡ä»¶æè¿°ç¬¦é™åˆ¶è°ƒæ•´](#7-æ–‡ä»¶æè¿°ç¬¦é™åˆ¶è°ƒæ•´)
8. [CPUäº²å’Œæ€§é…ç½®](#8-CPUäº²å’Œæ€§é…ç½®)
9. [æ€§èƒ½ç›‘æ§ä¸åŸºå‡†æµ‹è¯•](#9-æ€§èƒ½ç›‘æ§ä¸åŸºå‡†æµ‹è¯•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ WebæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯WebæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> WebæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–æ˜¯é€šè¿‡è°ƒæ•´æœåŠ¡å™¨é…ç½®ã€ä¼˜åŒ–èµ„æºå¤„ç†æ–¹å¼ã€æ”¹å–„ç½‘ç»œä¼ è¾“æ•ˆç‡æ¥æå‡ç½‘ç«™å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒçš„è¿‡ç¨‹

ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒä¼˜åŒ–é¤å…æœåŠ¡æµç¨‹
- **ä¼ ç»Ÿé¤å…**ï¼šæ¯æ¬¡éƒ½é‡æ–°å‡†å¤‡ï¼Œå®¢äººç­‰å¾…æ—¶é—´é•¿
- **ä¼˜åŒ–é¤å…**ï¼šæå‰å‡†å¤‡çƒ­é—¨èœå“ï¼Œä½¿ç”¨ä¿æ¸©è®¾å¤‡ï¼Œå®¢äººå¿«é€Ÿå–é¤

### 1.2 æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒç›®æ ‡


```
ğŸ¯ ä¸»è¦ç›®æ ‡ï¼š
å“åº”é€Ÿåº¦æå‡ â”€â”€â”€â”€> ç”¨æˆ·ä½“éªŒæ”¹å–„
å¹¶å‘å¤„ç†èƒ½åŠ› â”€â”€â”€â”€> æ”¯æŒæ›´å¤šç”¨æˆ·  
èµ„æºåˆ©ç”¨ç‡ â”€â”€â”€â”€â”€â”€> é™ä½æœåŠ¡å™¨æˆæœ¬
ç³»ç»Ÿç¨³å®šæ€§ â”€â”€â”€â”€â”€â”€> å‡å°‘å®•æœºé£é™©
```

**ğŸ“Š æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”**ï¼š
| ä¼˜åŒ–é¡¹ç›® | **ä¼˜åŒ–å‰** | **ä¼˜åŒ–å** | **æå‡æ•ˆæœ** |
|---------|-----------|-----------|-------------|
| é¡µé¢åŠ è½½æ—¶é—´ | `3-5ç§’` | `1-2ç§’` | `æå‡60%` |
| å¹¶å‘è¿æ¥æ•° | `1000` | `5000+` | `æå‡400%` |
| æœåŠ¡å™¨è´Ÿè½½ | `CPU 80%` | `CPU 40%` | `é™ä½50%` |
| å¸¦å®½ä½¿ç”¨ | `100Mbps` | `60Mbps` | `èŠ‚çœ40%` |

---

## 2. ğŸ’¾ é™æ€èµ„æºç¼“å­˜é…ç½®


### 2.1 ç¼“å­˜çš„åŸºæœ¬åŸç†


ğŸ” **æŠ€æœ¯ç±»æ¯”**ï¼šç¼“å­˜å°±åƒå®¶é‡Œçš„å†°ç®±
- **æ²¡æœ‰å†°ç®±**ï¼šæ¯æ¬¡åšé¥­éƒ½è¦å»èœå¸‚åœºä¹°èœï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½è®¿é—®ç¡¬ç›˜ï¼‰
- **æœ‰äº†å†°ç®±**ï¼šæå‰ä¹°å¥½èœæ”¾å†°ç®±ï¼Œåšé¥­æ—¶ç›´æ¥å–ç”¨ï¼ˆé™æ€æ–‡ä»¶ç¼“å­˜åœ¨å†…å­˜ï¼‰

### 2.2 Nginxé™æ€èµ„æºç¼“å­˜é…ç½®


**åŸºç¡€é…ç½®ç¤ºä¾‹**ï¼š
```nginx
# å›¾ç‰‡èµ„æºç¼“å­˜é…ç½®
location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
    expires 30d;                    # ç¼“å­˜30å¤©
    add_header Cache-Control "public, immutable";
    access_log off;                 # ä¸è®°å½•è®¿é—®æ—¥å¿—
}

# CSSå’ŒJSç¼“å­˜é…ç½®  
location ~* \.(css|js)$ {
    expires 7d;                     # ç¼“å­˜7å¤©
    add_header Cache-Control "public";
}

# å­—ä½“æ–‡ä»¶ç¼“å­˜
location ~* \.(woff|woff2|ttf|eot)$ {
    expires 1y;                     # ç¼“å­˜1å¹´
    add_header Cache-Control "public, immutable";
}
```

### 2.3 Apacheé™æ€èµ„æºç¼“å­˜é…ç½®


```apache
# å¯ç”¨ç¼“å­˜æ¨¡å—
LoadModule expires_module modules/mod_expires.so
LoadModule headers_module modules/mod_headers.so

# ç¼“å­˜é…ç½®
<IfModule mod_expires.c>
    ExpiresActive On
    
    # å›¾ç‰‡ç¼“å­˜30å¤©
    ExpiresByType image/jpg "access plus 30 days"
    ExpiresByType image/png "access plus 30 days"
    
    # CSS/JSç¼“å­˜7å¤©
    ExpiresByType text/css "access plus 7 days"
    ExpiresByType application/javascript "access plus 7 days"
</IfModule>
```

### 2.4 ç¼“å­˜ç­–ç•¥ä¼˜åŒ–


ğŸ“‹ **æ¨èç¼“å­˜æ—¶é—´**ï¼š
- **ğŸ–¼ï¸ å›¾ç‰‡æ–‡ä»¶**ï¼š30å¤©-1å¹´ï¼ˆä¸ç»å¸¸å˜åŒ–ï¼‰
- **ğŸ¨ CSS/JS**ï¼š7-30å¤©ï¼ˆå¯èƒ½éœ€è¦æ›´æ–°ï¼‰
- **ğŸ“„ HTMLæ–‡ä»¶**ï¼šä¸ç¼“å­˜æˆ–çŸ­æ—¶é—´ï¼ˆå†…å®¹ç»å¸¸å˜åŒ–ï¼‰
- **ğŸ”¤ å­—ä½“æ–‡ä»¶**ï¼š1å¹´ï¼ˆåŸºæœ¬ä¸å˜ï¼‰

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> ç¼“å­˜æ—¶é—´è¿‡é•¿å¯èƒ½å¯¼è‡´ç”¨æˆ·çœ‹ä¸åˆ°æœ€æ–°å†…å®¹ï¼Œè¿‡çŸ­åˆ™å¤±å»ç¼“å­˜æ„ä¹‰

---

## 3. ğŸ—œï¸ Gzipå‹ç¼©é…ç½®


### 3.1 Gzipå‹ç¼©åŸç†


ğŸ§  **è®°å¿†å£è¯€**ï¼šå‹ç¼©ä¼ è¾“çœå¸¦å®½ï¼Œæ–‡æœ¬æ•ˆæœæœ€æ˜æ˜¾

ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒå¯„å¿«é€’æ—¶çš„çœŸç©ºå‹ç¼©è¢‹
- **å‹ç¼©å‰**ï¼šè¡£æœè“¬æ¾å ç”¨å¤§ç©ºé—´ï¼ˆåŸå§‹æ–‡ä»¶å¤§ï¼‰
- **å‹ç¼©å**ï¼šè¡£æœç´§å®èŠ‚çœç©ºé—´ï¼ˆä¼ è¾“æ–‡ä»¶å°ï¼‰
- **åˆ°è¾¾å**ï¼šå–å‡ºè¡£æœæ¢å¤åŸçŠ¶ï¼ˆæµè§ˆå™¨è§£å‹æ˜¾ç¤ºï¼‰

### 3.2 Nginx Gzipé…ç½®


```nginx
# Gzipå‹ç¼©é…ç½®
gzip on;                           # å¯ç”¨gzip
gzip_vary on;                      # æ ¹æ®è¯·æ±‚å¤´å†³å®šæ˜¯å¦å‹ç¼©
gzip_min_length 1024;              # æœ€å°å‹ç¼©æ–‡ä»¶å¤§å°1KB
gzip_comp_level 6;                 # å‹ç¼©çº§åˆ«(1-9)

# éœ€è¦å‹ç¼©çš„æ–‡ä»¶ç±»å‹
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/javascript
    application/xml+rss
    application/json;

# ç¦ç”¨ç‰¹å®šæµè§ˆå™¨çš„gzip
gzip_disable "msie6";
```

### 3.3 Apache Gzipé…ç½®


```apache
# å¯ç”¨å‹ç¼©æ¨¡å—
LoadModule deflate_module modules/mod_deflate.so

# å‹ç¼©é…ç½®
<IfModule mod_deflate.c>
    # å‹ç¼©æ–‡æœ¬ç±»å‹æ–‡ä»¶
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/javascript
    
    # è®¾ç½®å‹ç¼©çº§åˆ«
    DeflateCompressionLevel 6
</IfModule>
```

### 3.4 å‹ç¼©æ•ˆæœåˆ†æ


**ğŸ“ˆ å‹ç¼©æ•ˆæœå¯¹æ¯”**ï¼š
| æ–‡ä»¶ç±»å‹ | **åŸå§‹å¤§å°** | **å‹ç¼©å** | **å‹ç¼©ç‡** |
|---------|-------------|-----------|-----------|
| HTMLæ–‡ä»¶ | `100KB` | `25KB` | `75%` |
| CSSæ–‡ä»¶ | `50KB` | `10KB` | `80%` |
| JavaScript | `200KB` | `60KB` | `70%` |
| å›¾ç‰‡æ–‡ä»¶ | `100KB` | `95KB` | `5%` |

ğŸ¯ **å…³é”®å‘ç°**ï¼šæ–‡æœ¬æ–‡ä»¶å‹ç¼©æ•ˆæœæ˜¾è‘—ï¼Œå›¾ç‰‡æ–‡ä»¶æ•ˆæœæœ‰é™

---

## 4. ğŸ”— é•¿è¿æ¥keep-aliveé…ç½®


### 4.1 é•¿è¿æ¥çš„å·¥ä½œåŸç†


**çŸ­è¿æ¥æ¨¡å¼**ï¼š
```
å®¢æˆ·ç«¯ â”€å»ºç«‹è¿æ¥â”€> æœåŠ¡å™¨
å®¢æˆ·ç«¯ â†â”€å‘é€æ•°æ®â”€â”€ æœåŠ¡å™¨  
å®¢æˆ·ç«¯ â”€æ–­å¼€è¿æ¥â”€> æœåŠ¡å™¨
å®¢æˆ·ç«¯ â”€å»ºç«‹è¿æ¥â”€> æœåŠ¡å™¨ (ä¸‹æ¬¡è¯·æ±‚é‡æ–°å»ºç«‹)
```

**é•¿è¿æ¥æ¨¡å¼**ï¼š
```
å®¢æˆ·ç«¯ â”€å»ºç«‹è¿æ¥â”€> æœåŠ¡å™¨
å®¢æˆ·ç«¯ â†â”€å‘é€æ•°æ®â”€â”€ æœåŠ¡å™¨
å®¢æˆ·ç«¯ â†â”€å‘é€æ•°æ®â”€â”€ æœåŠ¡å™¨ (å¤ç”¨è¿æ¥)
å®¢æˆ·ç«¯ â†â”€å‘é€æ•°æ®â”€â”€ æœåŠ¡å™¨ (å¤ç”¨è¿æ¥)
å®¢æˆ·ç«¯ â”€è¶…æ—¶æ–­å¼€â”€> æœåŠ¡å™¨
```

ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šé•¿è¿æ¥åƒæ˜¯åŒ…å¹´çš„å¿«é€’æœåŠ¡
- **çŸ­è¿æ¥**ï¼šæ¯æ¬¡å¯„å¿«é€’éƒ½è¦é‡æ–°ç­¾åˆåŒ
- **é•¿è¿æ¥**ï¼šç­¾ä¸€æ¬¡åˆåŒï¼Œä¸€å¹´å†…éƒ½å¯ä»¥å¯„å¿«é€’

### 4.2 Nginx Keep-Aliveé…ç½®


```nginx
# HTTP Keep-Aliveé…ç½®
keepalive_timeout 65;              # è¿æ¥è¶…æ—¶æ—¶é—´65ç§’
keepalive_requests 1000;           # æ¯ä¸ªè¿æ¥æœ€å¤šå¤„ç†1000ä¸ªè¯·æ±‚

# ä¸Šæ¸¸æœåŠ¡å™¨è¿æ¥æ± 
upstream backend {
    server 192.168.1.10:8080;
    keepalive 32;                   # ä¿æŒ32ä¸ªç©ºé—²è¿æ¥
}

server {
    location / {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
    }
}
```

### 4.3 Apache Keep-Aliveé…ç½®


```apache
# å¯ç”¨Keep-Alive
KeepAlive On

# æ¯ä¸ªè¿æ¥æœ€å¤šå¤„ç†100ä¸ªè¯·æ±‚
MaxKeepAliveRequests 100

# è¿æ¥è¶…æ—¶æ—¶é—´15ç§’
KeepAliveTimeout 15
```

### 4.4 é•¿è¿æ¥ä¼˜åŒ–è¦ç‚¹


ğŸ“‹ **é…ç½®å»ºè®®**ï¼š
- **ğŸ• è¶…æ—¶æ—¶é—´**ï¼š`30-120ç§’`ï¼ˆå¤ªçŸ­é¢‘ç¹å»ºè¿ï¼Œå¤ªé•¿å ç”¨èµ„æºï¼‰
- **ğŸ“Š è¯·æ±‚æ•°é‡**ï¼š`100-1000`ï¼ˆæ ¹æ®æœåŠ¡å™¨æ€§èƒ½è°ƒæ•´ï¼‰
- **âš¡ è¿æ¥æ± å¤§å°**ï¼š`CPUæ ¸å¿ƒæ•° Ã— 2-4`

> ğŸ’¡ **ä¼˜åŒ–å»ºè®®**  
> æ ¹æ®ç½‘ç«™è®¿é—®æ¨¡å¼è°ƒæ•´ï¼šæ–°é—»ç½‘ç«™é€‚åˆè¾ƒçŸ­è¶…æ—¶ï¼Œåœ¨çº¿åº”ç”¨é€‚åˆè¾ƒé•¿è¶…æ—¶

---

## 5. ğŸš¦ å¹¶å‘è¿æ¥æ•°é™åˆ¶


### 5.1 å¹¶å‘æ§åˆ¶çš„é‡è¦æ€§


ğŸ” **æŠ€æœ¯ç±»æ¯”**ï¼šå¹¶å‘é™åˆ¶åƒæ˜¯é“¶è¡Œçš„æ’é˜Ÿç³»ç»Ÿ
- **æ— é™åˆ¶**ï¼šæ‰€æœ‰äººåŒæ—¶æŒ¤å‘æŸœå°ï¼Œé€ æˆæ··ä¹±
- **æœ‰é™åˆ¶**ï¼šæŒ‰åºæ’é˜Ÿï¼Œä¿è¯æœåŠ¡è´¨é‡

### 5.2 ç³»ç»Ÿçº§å¹¶å‘é™åˆ¶


**æŸ¥çœ‹å½“å‰è¿æ¥æ•°**ï¼š
```bash
# æŸ¥çœ‹å½“å‰TCPè¿æ¥çŠ¶æ€
netstat -an | grep :80 | wc -l

# æŸ¥çœ‹å…·ä½“è¿æ¥çŠ¶æ€åˆ†å¸ƒ
netstat -an | grep :80 | awk '{print $6}' | sort | uniq -c
```

**è°ƒæ•´ç³»ç»Ÿé™åˆ¶**ï¼š
```bash
# ä¸´æ—¶è°ƒæ•´æœ€å¤§æ–‡ä»¶æè¿°ç¬¦
ulimit -n 65535

# æ°¸ä¹…è°ƒæ•´ï¼ˆç¼–è¾‘/etc/security/limits.confï¼‰
nginx soft nofile 65535
nginx hard nofile 65535
```

### 5.3 Nginxå¹¶å‘æ§åˆ¶


```nginx
# å·¥ä½œè¿›ç¨‹é…ç½®
worker_processes auto;             # è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•°
worker_connections 4096;           # æ¯ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°

# é™åˆ¶å•IPè¿æ¥æ•°
http {
    limit_conn_zone $binary_remote_addr zone=perip:10m;
    limit_conn_zone $server_name zone=perserver:10m;
    
    server {
        limit_conn perip 20;       # æ¯ä¸ªIPæœ€å¤š20ä¸ªè¿æ¥
        limit_conn perserver 2000; # æ•´ä¸ªæœåŠ¡å™¨æœ€å¤š2000è¿æ¥
    }
}
```

### 5.4 Apacheå¹¶å‘æ§åˆ¶


```apache
# ä½¿ç”¨preforkæ¨¡å¼
<IfModule mpm_prefork_module>
    StartServers          8         # å¯åŠ¨æ—¶è¿›ç¨‹æ•°
    MinSpareServers       5         # æœ€å°ç©ºé—²è¿›ç¨‹
    MaxSpareServers      20         # æœ€å¤§ç©ºé—²è¿›ç¨‹
    MaxRequestWorkers   256         # æœ€å¤§å¹¶å‘è¿æ¥
    MaxConnectionsPerChild 4000     # æ¯ä¸ªè¿›ç¨‹æœ€å¤§è¯·æ±‚æ•°
</IfModule>

# ä½¿ç”¨workeræ¨¡å¼ï¼ˆæ¨èï¼‰
<IfModule mpm_worker_module>
    StartServers          3
    ThreadsPerChild      50         # æ¯ä¸ªè¿›ç¨‹çº¿ç¨‹æ•°
    MaxRequestWorkers  1000         # æœ€å¤§å¹¶å‘è¿æ¥
</IfModule>
```

### 5.5 å¹¶å‘ä¼˜åŒ–ç­–ç•¥


**ğŸ“Š æ€§èƒ½è®¡ç®—å…¬å¼**ï¼š
```
ç†è®ºæœ€å¤§å¹¶å‘ = worker_processes Ã— worker_connections
å®é™…å¹¶å‘ â‰ˆ ç†è®ºæœ€å¤§å¹¶å‘ Ã— 0.7-0.8 (è€ƒè™‘åå‘ä»£ç†ç­‰å› ç´ )
```

ğŸ¯ **ä¼˜åŒ–åŸåˆ™**ï¼š
- âœ… **CPUå¯†é›†å‹**ï¼š`worker_processes = CPUæ ¸å¿ƒæ•°`
- âœ… **IOå¯†é›†å‹**ï¼š`worker_processes = CPUæ ¸å¿ƒæ•° Ã— 2`
- âœ… **å†…å­˜å……è¶³**ï¼šé€‚å½“å¢åŠ `worker_connections`

---

## 6. ğŸ“¦ ç¼“å†²åŒºå¤§å°è°ƒä¼˜


### 6.1 ç¼“å†²åŒºçš„ä½œç”¨åŸç†


ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šç¼“å†²åŒºåƒæ˜¯å¿«é€’ä¸­è½¬ç«™
- **å°ä¸­è½¬ç«™**ï¼šè´§ç‰©å †ç§¯ï¼Œå¤„ç†ç¼“æ…¢
- **å¤§ä¸­è½¬ç«™**ï¼šè´§ç‰©æµè½¬é¡ºç•…ï¼Œæ•ˆç‡é«˜

### 6.2 Nginxç¼“å†²åŒºé…ç½®


```nginx
# å®¢æˆ·ç«¯ç¼“å†²åŒºé…ç½®
client_body_buffer_size 128k;      # å®¢æˆ·ç«¯è¯·æ±‚ä½“ç¼“å†²åŒº
client_max_body_size 10m;          # æœ€å¤§è¯·æ±‚ä½“å¤§å°
client_header_buffer_size 1k;      # è¯·æ±‚å¤´ç¼“å†²åŒº
large_client_header_buffers 4 4k;  # å¤§è¯·æ±‚å¤´ç¼“å†²åŒº

# ä»£ç†ç¼“å†²åŒºé…ç½®
proxy_buffer_size 4k;              # ä»£ç†ç¼“å†²åŒºå¤§å°
proxy_buffers 8 4k;                # ä»£ç†ç¼“å†²åŒºæ•°é‡å’Œå¤§å°
proxy_busy_buffers_size 8k;        # å¿™ç¢Œç¼“å†²åŒºå¤§å°

# è¾“å‡ºç¼“å†²åŒºé…ç½®
output_buffers 2 32k;              # è¾“å‡ºç¼“å†²åŒº
```

### 6.3 Apacheç¼“å†²åŒºé…ç½®


```apache
# é™åˆ¶è¯·æ±‚å¤§å°
LimitRequestBody 10485760          # 10MB
LimitRequestFields 100             # æœ€å¤§å­—æ®µæ•°
LimitRequestFieldSize 8190         # å­—æ®µå¤§å°

# è¾“å‡ºç¼“å†²
<IfModule mod_buffer.c>
    SetOutputFilter BUFFER
    SetEnvIf Content-Type text/html BUFFER
    BufferSize 65536               # 64KBç¼“å†²åŒº
</IfModule>
```

### 6.4 ç¼“å†²åŒºä¼˜åŒ–å»ºè®®


ğŸ“‹ **é…ç½®æŒ‡å—**ï¼š
| åº”ç”¨ç±»å‹ | **buffer_size** | **buffersæ•°é‡** | **é€‚ç”¨åœºæ™¯** |
|---------|---------------|---------------|-------------|
| é™æ€ç½‘ç«™ | `4k` | `4-8ä¸ª` | `ä¸€èˆ¬è®¿é—®` |
| åŠ¨æ€åº”ç”¨ | `8k` | `8-16ä¸ª` | `APIæ¥å£` |
| æ–‡ä»¶ä¸Šä¼  | `16k` | `16-32ä¸ª` | `å¤§æ–‡ä»¶å¤„ç†` |

> âš ï¸ **æ³¨æ„å¹³è¡¡**  
> ç¼“å†²åŒºè¿‡å¤§æµªè´¹å†…å­˜ï¼Œè¿‡å°å½±å“æ€§èƒ½ã€‚æ ¹æ®å®é™…å†…å­˜å¤§å°å’Œå¹¶å‘é‡è°ƒæ•´

---

## 7. ğŸ“ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶è°ƒæ•´


### 7.1 æ–‡ä»¶æè¿°ç¬¦çš„æ¦‚å¿µ


ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
æ–‡ä»¶æè¿°ç¬¦æ˜¯Linuxç³»ç»Ÿä¸­æ ‡è¯†æ‰“å¼€æ–‡ä»¶çš„æ•°å­—ï¼Œæ¯ä¸ªç½‘ç»œè¿æ¥ã€æ‰“å¼€çš„æ–‡ä»¶éƒ½éœ€è¦å ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦

ğŸ§  **è®°å¿†å£è¯€**ï¼šè¿æ¥å¤šå°‘çœ‹æè¿°ç¬¦ï¼Œä¸å¤Ÿç”¨æ—¶è¦è°ƒæ•´

### 7.2 æŸ¥çœ‹å½“å‰é™åˆ¶


```bash
# æŸ¥çœ‹å½“å‰ç”¨æˆ·é™åˆ¶
ulimit -n

# æŸ¥çœ‹ç³»ç»Ÿå…¨å±€é™åˆ¶  
cat /proc/sys/fs/file-max

# æŸ¥çœ‹å½“å‰ä½¿ç”¨æƒ…å†µ
cat /proc/sys/fs/file-nr
```

### 7.3 ä¸´æ—¶è°ƒæ•´é™åˆ¶


```bash
# ä¸´æ—¶å¢åŠ å½“å‰ä¼šè¯é™åˆ¶
ulimit -n 65535

# ä¸´æ—¶è°ƒæ•´ç³»ç»Ÿå…¨å±€é™åˆ¶
echo 100000 > /proc/sys/fs/file-max
```

### 7.4 æ°¸ä¹…è°ƒæ•´é™åˆ¶


**ç¼–è¾‘limits.confæ–‡ä»¶**ï¼š
```bash
# ç¼–è¾‘ /etc/security/limits.conf
nginx  soft  nofile  65535
nginx  hard  nofile  65535
*      soft  nofile  65535  
*      hard  nofile  65535
```

**è°ƒæ•´ç³»ç»Ÿå‚æ•°**ï¼š
```bash
# ç¼–è¾‘ /etc/sysctl.conf
fs.file-max = 100000
fs.nr_open = 100000

# åº”ç”¨é…ç½®
sysctl -p
```

### 7.5 WebæœåŠ¡å™¨ç‰¹å®šé…ç½®


**Nginxé…ç½®**ï¼š
```nginx
# åœ¨nginx.confä¸­æ·»åŠ 
worker_rlimit_nofile 65535;
```

**SystemdæœåŠ¡é…ç½®**ï¼š
```ini
# ç¼–è¾‘ /etc/systemd/system/nginx.service
[Service]
LimitNOFILE=65535
```

**è®¡ç®—å…¬å¼**ï¼š
```
æ¨èæ–‡ä»¶æè¿°ç¬¦æ•° = é¢„æœŸæœ€å¤§å¹¶å‘è¿æ¥æ•° Ã— 2-4
(è€ƒè™‘åˆ°æ¯ä¸ªè¿æ¥å¯èƒ½éœ€è¦å¤šä¸ªæè¿°ç¬¦)
```

---

## 8. ğŸ”§ CPUäº²å’Œæ€§é…ç½®


### 8.1 CPUäº²å’Œæ€§çš„æ¦‚å¿µ


ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šCPUäº²å’Œæ€§åƒæ˜¯ä¸“äººä¸“å²—
- **æ— äº²å’Œæ€§**ï¼šå·¥äººéšæœºåˆ†é…ä»»åŠ¡ï¼Œæ•ˆç‡ä¸ç¨³å®š
- **æœ‰äº²å’Œæ€§**ï¼šå·¥äººå›ºå®šè´Ÿè´£ç‰¹å®šåŒºåŸŸï¼Œæ•ˆç‡æ›´é«˜

### 8.2 Nginx CPUäº²å’Œæ€§é…ç½®


```nginx
# æŸ¥çœ‹CPUæ ¸å¿ƒæ•°
grep processor /proc/cpuinfo | wc -l

# 4æ ¸CPUçš„äº²å’Œæ€§é…ç½®
worker_processes 4;
worker_cpu_affinity 0001 0010 0100 1000;

# 8æ ¸CPUçš„äº²å’Œæ€§é…ç½®  
worker_processes 8;
worker_cpu_affinity 00000001 00000010 00000100 00001000 
                    00010000 00100000 01000000 10000000;

# è‡ªåŠ¨é…ç½®ï¼ˆæ¨èï¼‰
worker_processes auto;
worker_cpu_affinity auto;
```

### 8.3 Apache CPUäº²å’Œæ€§é…ç½®


Apacheéœ€è¦é€šè¿‡ç³»ç»Ÿå·¥å…·è®¾ç½®ï¼š
```bash
# å®‰è£…å·¥å…·
yum install util-linux

# å¯åŠ¨Apacheå¹¶ç»‘å®šCPU
taskset -c 0-3 systemctl start httpd

# æˆ–è€…åœ¨å¯åŠ¨è„šæœ¬ä¸­è®¾ç½®
taskset -c 0,2,4,6 /usr/sbin/httpd
```

### 8.4 äº²å’Œæ€§é…ç½®éªŒè¯


```bash
# æŸ¥çœ‹è¿›ç¨‹CPUç»‘å®šæƒ…å†µ
ps -eo pid,psr,comm | grep nginx

# å®æ—¶ç›‘æ§CPUä½¿ç”¨æƒ…å†µ
htop
# æˆ–è€…
top -p $(pgrep nginx | tr '\n' ',' | sed 's/,$//')
```

**ğŸ“Š æ€§èƒ½æå‡æ•ˆæœ**ï¼š
- âœ… **ç¼“å­˜å‘½ä¸­ç‡**ï¼šæå‡15-30%
- âœ… **ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼šå‡å°‘20-40%  
- âœ… **æ•´ä½“æ€§èƒ½**ï¼šæå‡5-15%

---

## 9. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸åŸºå‡†æµ‹è¯•


### 9.1 æ€§èƒ½ç›‘æ§å·¥å…·


**ç³»ç»Ÿçº§ç›‘æ§**ï¼š
```bash
# CPUå’Œå†…å­˜ç›‘æ§
top
htop
iostat 1

# ç½‘ç»œè¿æ¥ç›‘æ§
netstat -tulpn
ss -tulpn

# å®æ—¶æµé‡ç›‘æ§
iftop
nethogs
```

**WebæœåŠ¡å™¨ç›‘æ§**ï¼š
```bash
# NginxçŠ¶æ€ç›‘æ§
curl http://localhost/nginx_status

# ApacheçŠ¶æ€ç›‘æ§  
curl http://localhost/server-status
```

### 9.2 æ€§èƒ½åŸºå‡†æµ‹è¯•


**Apache Bench (ab)æµ‹è¯•**ï¼š
```bash
# å¹¶å‘100ï¼Œæ€»è¯·æ±‚1000
ab -c 100 -n 1000 http://localhost/

# å¸¦Cookieçš„æµ‹è¯•
ab -c 50 -n 500 -C "session=abc123" http://localhost/login

# æµ‹è¯•ç»“æœé‡ç‚¹å…³æ³¨ï¼š
# - Requests per second (RPS)
# - Time per request (å“åº”æ—¶é—´)
# - Failed requests (å¤±è´¥è¯·æ±‚)
```

**Siegeå‹åŠ›æµ‹è¯•**ï¼š
```bash
# å®‰è£…siege
yum install siege

# å¹¶å‘æµ‹è¯•15åˆ†é’Ÿ
siege -c 100 -t 15M http://localhost/

# ä»URLæ–‡ä»¶æµ‹è¯•
siege -c 50 -f urls.txt
```

**wrké«˜æ€§èƒ½æµ‹è¯•**ï¼š
```bash
# ç¼–è¯‘å®‰è£…wrk
git clone https://github.com/wg/wrk.git
cd wrk && make

# è¿è¡Œæµ‹è¯•
./wrk -c 100 -t 4 -d 30s http://localhost/
```

### 9.3 ç›‘æ§é…ç½®ç¤ºä¾‹


**NginxçŠ¶æ€é¡µé¢é…ç½®**ï¼š
```nginx
server {
    listen 80;
    server_name localhost;
    
    location /nginx_status {
        stub_status on;
        access_log off;
        allow 127.0.0.1;
        deny all;
    }
}
```

**ApacheçŠ¶æ€é¡µé¢é…ç½®**ï¼š
```apache
<Location "/server-status">
    SetHandler server-status
    Require ip 127.0.0.1
</Location>

<Location "/server-info">
    SetHandler server-info
    Require ip 127.0.0.1
</Location>
```

### 9.4 æ€§èƒ½ç›‘æ§æŒ‡æ ‡


ğŸ“‹ **å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
| æŒ‡æ ‡ç±»å‹ | **ç›‘æ§é¡¹ç›®** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|---------|-------------|-------------|-------------|
| **å“åº”æ€§èƒ½** | `å¹³å‡å“åº”æ—¶é—´` | `< 200ms` | `> 1000ms` |
| **å¹¶å‘èƒ½åŠ›** | `QPS/RPS` | `> 1000` | `< 100` |
| **èµ„æºä½¿ç”¨** | `CPUä½¿ç”¨ç‡` | `< 70%` | `> 85%` |
| **èµ„æºä½¿ç”¨** | `å†…å­˜ä½¿ç”¨ç‡` | `< 80%` | `> 90%` |
| **è¿æ¥çŠ¶æ€** | `æ´»è·ƒè¿æ¥æ•°` | `ç¨³å®š` | `å¼‚å¸¸å¢é•¿` |

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 æ€§èƒ½ä¼˜åŒ–æ ¸å¿ƒç­–ç•¥


ğŸ¯ **å››å¤§ä¼˜åŒ–æ–¹å‘**ï¼š
```
ç¼“å­˜ä¼˜åŒ– â”€â”€â”€â”€> å‡å°‘é‡å¤è®¡ç®—å’ŒIOæ“ä½œ
å‹ç¼©ä¼˜åŒ– â”€â”€â”€â”€> å‡å°‘ç½‘ç»œä¼ è¾“æ—¶é—´  
è¿æ¥ä¼˜åŒ– â”€â”€â”€â”€> æé«˜è¿æ¥å¤ç”¨æ•ˆç‡
èµ„æºä¼˜åŒ– â”€â”€â”€â”€> å……åˆ†åˆ©ç”¨ç¡¬ä»¶æ€§èƒ½
```

### 10.2 ä¼˜åŒ–å®æ–½æ£€æŸ¥æ¸…å•


ğŸ“‹ **å®æ–½æ£€æŸ¥æ¸…å•**ï¼š
- [ ] âœ… é…ç½®é™æ€èµ„æºç¼“å­˜ç­–ç•¥
- [ ] âœ… å¯ç”¨Gzipå‹ç¼©å¹¶é…ç½®æ–‡ä»¶ç±»å‹
- [ ] âœ… è°ƒæ•´Keep-Aliveå‚æ•°
- [ ] âœ… è®¾ç½®åˆç†çš„å¹¶å‘è¿æ¥é™åˆ¶
- [ ] âœ… ä¼˜åŒ–ç¼“å†²åŒºå¤§å°é…ç½®
- [ ] âœ… è°ƒæ•´æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
- [ ] âœ… é…ç½®CPUäº²å’Œæ€§ç»‘å®š
- [ ] âœ… éƒ¨ç½²ç›‘æ§å’Œæµ‹è¯•å·¥å…·

### 10.3 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ


**ğŸ”¥ é«˜ä¼˜å…ˆçº§ä¼˜åŒ–**ï¼š
1. **é™æ€èµ„æºç¼“å­˜**ï¼šç«‹å³è§æ•ˆï¼Œå®æ–½ç®€å•
2. **Gzipå‹ç¼©**ï¼šæ˜¾è‘—å‡å°‘å¸¦å®½ä½¿ç”¨
3. **Keep-Alive**ï¼šå‡å°‘è¿æ¥å¼€é”€

**â­ ä¸­ä¼˜å…ˆçº§ä¼˜åŒ–**ï¼š
4. **å¹¶å‘æ•°è°ƒä¼˜**ï¼šæ ¹æ®ç¡¬ä»¶é…ç½®è°ƒæ•´
5. **ç¼“å†²åŒºä¼˜åŒ–**ï¼šæå‡æ•°æ®å¤„ç†æ•ˆç‡

**ğŸ’« ä½ä¼˜å…ˆçº§ä¼˜åŒ–**ï¼š
6. **CPUäº²å’Œæ€§**ï¼šåœ¨é«˜è´Ÿè½½æ—¶æ‰æ˜æ˜¾
7. **æ–‡ä»¶æè¿°ç¬¦**ï¼šè¾¾åˆ°ç“¶é¢ˆæ—¶æ‰éœ€è¦

### 10.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


ğŸ” **å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š

**é—®é¢˜1ï¼šç½‘ç«™è®¿é—®æ…¢**
```
æ’æŸ¥æ­¥éª¤ï¼š
æ£€æŸ¥ç¼“å­˜é…ç½® â†’ éªŒè¯å‹ç¼©æ˜¯å¦ç”Ÿæ•ˆ â†’ æµ‹è¯•ç½‘ç»œå¸¦å®½ â†’ æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½
```

**é—®é¢˜2ï¼šå¹¶å‘è¿æ¥å¤±è´¥**
```
æ’æŸ¥æ­¥éª¤ï¼š  
æ£€æŸ¥è¿æ¥æ•°é™åˆ¶ â†’ æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦ â†’ éªŒè¯é˜²ç«å¢™è®¾ç½® â†’ æµ‹è¯•è´Ÿè½½å‡è¡¡
```

**é—®é¢˜3ï¼šæœåŠ¡å™¨è´Ÿè½½é«˜**
```
æ’æŸ¥æ­¥éª¤ï¼š
æŸ¥çœ‹CPUä½¿ç”¨ç‡ â†’ æ£€æŸ¥å†…å­˜ä½¿ç”¨ â†’ åˆ†ææ…¢æŸ¥è¯¢ â†’ ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
```

### 10.5 æ€§èƒ½ä¼˜åŒ–è¿›é˜¶å»ºè®®


ğŸ’¡ **è¿›é˜¶ä¼˜åŒ–æ–¹å‘**ï¼š
- **ğŸŒ CDNåŠ é€Ÿ**ï¼šå…¨çƒå†…å®¹åˆ†å‘ç½‘ç»œ
- **ğŸ”„ è´Ÿè½½å‡è¡¡**ï¼šå¤šæœåŠ¡å™¨åˆ†æ‹…å‹åŠ›
- **ğŸ“± HTTP/2**ï¼šå¤šè·¯å¤ç”¨æå‡æ•ˆç‡  
- **ğŸ›¡ï¸ ç¼“å­˜ç­–ç•¥**ï¼šRedis/Memcachedåº”ç”¨ç¼“å­˜
- **ğŸ—ƒï¸ æ•°æ®åº“ä¼˜åŒ–**ï¼šç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–

**ğŸ§  æ ¸å¿ƒè®°å¿†**ï¼š
- ç¼“å­˜å‹ç¼©æ˜¯åŸºç¡€ï¼Œè¿æ¥ä¼˜åŒ–ææ•ˆç‡
- èµ„æºé™åˆ¶è¦è°ƒå¤Ÿï¼Œç›‘æ§æµ‹è¯•ä¸èƒ½å°‘  
- å…ˆæ˜“åéš¾åˆ†ä¼˜å…ˆï¼ŒæŒç»­ä¼˜åŒ–è§çœŸç« 
- ç†è®ºå®è·µè¦ç»“åˆï¼Œç”¨æˆ·ä½“éªŒæ˜¯ç›®æ ‡

> ğŸ’¡ **æœ€ç»ˆå»ºè®®**  
> æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚å’Œç”¨æˆ·è®¿é—®æ¨¡å¼ä¸æ–­è°ƒæ•´ã€‚é‡è¦çš„æ˜¯å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ï¼ŒåŸºäºæ•°æ®åšå†³ç­–ï¼Œé¿å…ç›²ç›®ä¼˜åŒ–ã€‚