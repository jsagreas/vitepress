---
title: 13ã€æ•°æ®åº“å®‰å…¨åŠ å›º
---
## ğŸ“š ç›®å½•

1. [æ•°æ®åº“å®‰å…¨åŠ å›ºæ¦‚è¿°](#1-æ•°æ®åº“å®‰å…¨åŠ å›ºæ¦‚è¿°)
2. [ç½‘ç»œè®¿é—®æ§åˆ¶ä¸é˜²ç«å¢™](#2-ç½‘ç»œè®¿é—®æ§åˆ¶ä¸é˜²ç«å¢™)
3. [SSL/TLSåŠ å¯†è¿æ¥é…ç½®](#3-SSL/TLSåŠ å¯†è¿æ¥é…ç½®)
4. [æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨](#4-æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨)
5. [å®¡è®¡æ—¥å¿—é…ç½®ä¸åˆ†æ](#5-å®¡è®¡æ—¥å¿—é…ç½®ä¸åˆ†æ)
6. [å®šæœŸå®‰å…¨æ›´æ–°ä¸è¡¥ä¸](#6-å®šæœŸå®‰å…¨æ›´æ–°ä¸è¡¥ä¸)
7. [æ•°æ®åº“æ–‡ä»¶æƒé™åŠ å›º](#7-æ•°æ®åº“æ–‡ä»¶æƒé™åŠ å›º)
8. [å¼±å¯†ç æ£€æŸ¥ä¸å¯†ç ç­–ç•¥](#8-å¼±å¯†ç æ£€æŸ¥ä¸å¯†ç ç­–ç•¥)
9. [é˜²SQLæ³¨å…¥åŸºç¡€é…ç½®](#9-é˜²SQLæ³¨å…¥åŸºç¡€é…ç½®)
10. [å¤‡ä»½æ–‡ä»¶å®‰å…¨å­˜å‚¨](#10-å¤‡ä»½æ–‡ä»¶å®‰å…¨å­˜å‚¨)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ æ•°æ®åº“å®‰å…¨åŠ å›ºæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“å®‰å…¨åŠ å›º


**å®šä¹‰è§£é‡Š**ï¼šæ•°æ®åº“å®‰å…¨åŠ å›ºå°±æ˜¯ç»™æ•°æ®åº“"åŠ è£…é˜²æŠ¤è£…å¤‡"ï¼Œå°±åƒç»™æˆ¿å­è£…é˜²ç›—é—¨ã€ç›‘æ§æ‘„åƒå¤´ä¸€æ ·ï¼Œé˜²æ­¢åäººè¿›å…¥å¹¶ä¿æŠ¤é‡è¦æ•°æ®ã€‚

**æ ¸å¿ƒç†å¿µ**ï¼š
```
å¤šå±‚é˜²æŠ¤æ€æƒ³ï¼š
å¤–å±‚é˜²æŠ¤ï¼šç½‘ç»œé˜²ç«å¢™ + è®¿é—®æ§åˆ¶
ä¼ è¾“é˜²æŠ¤ï¼šSSLåŠ å¯†é€šä¿¡
å†…éƒ¨é˜²æŠ¤ï¼šç”¨æˆ·æƒé™ + æ•°æ®åŠ å¯†
ç›‘æ§é˜²æŠ¤ï¼šå®¡è®¡æ—¥å¿— + å¼‚å¸¸æ£€æµ‹
ç‰©ç†é˜²æŠ¤ï¼šæ–‡ä»¶æƒé™ + å¤‡ä»½åŠ å¯†
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“å®‰å…¨åŠ å›º


**ç°å®å¨èƒ**ï¼š
- **é»‘å®¢æ”»å‡»**ï¼šé€šè¿‡ç½‘ç»œå…¥ä¾µçªƒå–æ•°æ®
- **å†…éƒ¨æ³„éœ²**ï¼šå‘˜å·¥è¯¯æ“ä½œæˆ–æ¶æ„æ³„éœ²
- **SQLæ³¨å…¥**ï¼šæ¶æ„ä»£ç ç ´åæ•°æ®åº“
- **æ•°æ®ä¸¢å¤±**ï¼šç¡¬ä»¶æ•…éšœæˆ–äººä¸ºåˆ é™¤
- **åˆè§„è¦æ±‚**ï¼šæ³•å¾‹æ³•è§„è¦æ±‚ä¿æŠ¤ç”¨æˆ·éšç§

**å®‰å…¨äº‹æ•…çš„ä»£ä»·**ï¼š
```
æ•°æ®æ³„éœ²åæœï¼š
ğŸ’° ç»æµæŸå¤±ï¼šç½šæ¬¾ + èµ”å¿ + ä¸šåŠ¡ä¸­æ–­
ğŸ“‰ ä¿¡èª‰æŸå¤±ï¼šå®¢æˆ·æµå¤± + å“ç‰Œå—æŸ
âš–ï¸ æ³•å¾‹åæœï¼šç›‘ç®¡å¤„ç½š + è¯‰è®¼é£é™©
ğŸ”’ æŠ€æœ¯åæœï¼šç³»ç»Ÿé‡å»º + å®‰å…¨å‡çº§
```

### 1.3 æ•°æ®åº“å®‰å…¨åŠ å›ºçš„å±‚æ¬¡ç»“æ„


```
ç½‘ç»œå±‚å®‰å…¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é˜²ç«å¢™è§„åˆ™     â”‚ â† é™åˆ¶è®¿é—®IPå’Œç«¯å£
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   VPN/ä¸“çº¿      â”‚ â† å®‰å…¨çš„ç½‘ç»œé€šé“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼ è¾“å±‚å®‰å…¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SSL/TLSåŠ å¯†   â”‚ â† æ•°æ®ä¼ è¾“åŠ å¯†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è¯ä¹¦éªŒè¯       â”‚ â† èº«ä»½è®¤è¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åº”ç”¨å±‚å®‰å…¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è®¤è¯       â”‚ â† ç”¨æˆ·åå¯†ç éªŒè¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æƒé™æ§åˆ¶       â”‚ â† ç»†ç²’åº¦è®¿é—®æ§åˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   SQLé˜²æ³¨å…¥     â”‚ â† æ¶æ„ä»£ç é˜²æŠ¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®å±‚å®‰å…¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®åŠ å¯†       â”‚ â† æ•æ„Ÿä¿¡æ¯åŠ å¯†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å¤‡ä»½åŠ å¯†       â”‚ â† å¤‡ä»½æ–‡ä»¶ä¿æŠ¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç›‘æ§å±‚å®‰å…¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¡è®¡æ—¥å¿—       â”‚ â† æ“ä½œè®°å½•è¿½è¸ª
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å¼‚å¸¸ç›‘æ§       â”‚ â† å®æ—¶å¨èƒæ£€æµ‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”¥ ç½‘ç»œè®¿é—®æ§åˆ¶ä¸é˜²ç«å¢™


### 2.1 ç½‘ç»œè®¿é—®æ§åˆ¶çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç½‘ç»œè®¿é—®æ§åˆ¶**ï¼šå°±åƒå°åŒºçš„é—¨ç¦ç³»ç»Ÿï¼Œåªå…è®¸æœ‰æƒé™çš„äººï¼ˆIPåœ°å€ï¼‰ä»æŒ‡å®šçš„å…¥å£ï¼ˆç«¯å£ï¼‰è¿›å…¥æ•°æ®åº“ã€‚

**æ§åˆ¶ç»´åº¦**ï¼š
- **IPåœ°å€æ§åˆ¶**ï¼šè°å¯ä»¥è¿æ¥
- **ç«¯å£æ§åˆ¶**ï¼šä»å“ªä¸ªé—¨è¿›å…¥
- **æ—¶é—´æ§åˆ¶**ï¼šä»€ä¹ˆæ—¶å€™å¯ä»¥è®¿é—®
- **åè®®æ§åˆ¶**ï¼šç”¨ä»€ä¹ˆæ–¹å¼è¿æ¥

### 2.2 MySQLç½‘ç»œè®¿é—®æ§åˆ¶é…ç½®


**ä¿®æ”¹é…ç½®æ–‡ä»¶**ï¼š
```bash
# ç¼–è¾‘MySQLé…ç½®æ–‡ä»¶
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

# ç»‘å®šç‰¹å®šIPåœ°å€ï¼ˆé»˜è®¤åªå…è®¸æœ¬åœ°è¿æ¥ï¼‰
bind-address = 127.0.0.1

# å¦‚éœ€å…è®¸æŒ‡å®šç½‘æ®µè®¿é—®
bind-address = 192.168.1.100
```

**ç”¨æˆ·è®¿é—®æƒé™æ§åˆ¶**ï¼š
```sql
-- åˆ›å»ºåªèƒ½ä»ç‰¹å®šIPè®¿é—®çš„ç”¨æˆ·
CREATE USER 'webuser'@'192.168.1.50' IDENTIFIED BY 'strong_password';

-- åˆ›å»ºåªèƒ½ä»ç‰¹å®šç½‘æ®µè®¿é—®çš„ç”¨æˆ·
CREATE USER 'appuser'@'192.168.1.%' IDENTIFIED BY 'strong_password';

-- æŸ¥çœ‹ç”¨æˆ·çš„è®¿é—®æƒé™
SELECT User, Host FROM mysql.user;

-- åˆ é™¤å±é™©çš„ç©ºç”¨æˆ·å’ŒåŒ¿åç”¨æˆ·
DELETE FROM mysql.user WHERE User = '';
DELETE FROM mysql.user WHERE User = 'root' AND Host != 'localhost';
FLUSH PRIVILEGES;
```

### 2.3 PostgreSQLç½‘ç»œè®¿é—®æ§åˆ¶é…ç½®


**é…ç½®å®¢æˆ·ç«¯è®¤è¯**ï¼š
```bash
# ç¼–è¾‘è®¤è¯é…ç½®æ–‡ä»¶
sudo nano /etc/postgresql/13/main/pg_hba.conf

# é…ç½®ç¤ºä¾‹ï¼ˆä»ä¸¥æ ¼åˆ°å®½æ¾ï¼‰
# TYPE  DATABASE    USER        ADDRESS         METHOD

# æœ¬åœ°è¿æ¥ä½¿ç”¨peerè®¤è¯
local   all         postgres                    peer

# æœ¬åœ°TCPè¿æ¥ä½¿ç”¨md5å¯†ç è®¤è¯
host    all         all         127.0.0.1/32    md5

# å…è®¸ç‰¹å®šç½‘æ®µè¿æ¥
host    myapp       appuser     192.168.1.0/24  md5

# æ‹’ç»æ‰€æœ‰å…¶ä»–è¿æ¥
host    all         all         0.0.0.0/0       reject
```

**ç›‘å¬åœ°å€é…ç½®**ï¼š
```bash
# ç¼–è¾‘ä¸»é…ç½®æ–‡ä»¶
sudo nano /etc/postgresql/13/main/postgresql.conf

# è®¾ç½®ç›‘å¬åœ°å€
listen_addresses = 'localhost'          # åªç›‘å¬æœ¬åœ°
# listen_addresses = '192.168.1.100'    # ç›‘å¬ç‰¹å®šIP
# listen_addresses = '*'                # ç›‘å¬æ‰€æœ‰IPï¼ˆä¸æ¨èï¼‰

# è®¾ç½®ç›‘å¬ç«¯å£
port = 5432
```

### 2.4 é˜²ç«å¢™é…ç½®


**iptablesé˜²ç«å¢™è§„åˆ™**ï¼š
```bash
# åªå…è®¸ç‰¹å®šIPè®¿é—®MySQL
sudo iptables -A INPUT -p tcp -s 192.168.1.50 --dport 3306 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 3306 -j DROP

# åªå…è®¸ç‰¹å®šç½‘æ®µè®¿é—®PostgreSQL
sudo iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 5432 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 5432 -j DROP

# ä¿å­˜è§„åˆ™
sudo iptables-save > /etc/iptables/rules.v4
```

**ufwé˜²ç«å¢™é…ç½®**ï¼š
```bash
# å¯ç”¨ufwé˜²ç«å¢™
sudo ufw enable

# å…è®¸ç‰¹å®šIPè®¿é—®MySQL
sudo ufw allow from 192.168.1.50 to any port 3306

# å…è®¸ç‰¹å®šç½‘æ®µè®¿é—®PostgreSQL
sudo ufw allow from 192.168.1.0/24 to any port 5432

# æŸ¥çœ‹è§„åˆ™çŠ¶æ€
sudo ufw status numbered
```

### 2.5 ç½‘ç»œè®¿é—®æ§åˆ¶æœ€ä½³å®è·µ


| æ§åˆ¶å±‚é¢ | **æ¨èåšæ³•** | **é¿å…åšæ³•** |
|---------|-------------|-------------|
| ğŸŒ **IPæ§åˆ¶** | `ä»…å…è®¸å¿…è¦çš„IP/ç½‘æ®µ` | `å…è®¸æ‰€æœ‰IPï¼ˆ0.0.0.0/0ï¼‰` |
| ğŸšª **ç«¯å£æ§åˆ¶** | `ä¿®æ”¹é»˜è®¤ç«¯å£ï¼Œé™åˆ¶è®¿é—®` | `ä½¿ç”¨é»˜è®¤ç«¯å£å¯¹å¤–å¼€æ”¾` |
| ğŸ‘¥ **ç”¨æˆ·æ§åˆ¶** | `ä¸“ç”¨ç”¨æˆ·ï¼Œæœ€å°æƒé™` | `ä½¿ç”¨rootç”¨æˆ·ç›´è¿` |
| ğŸ• **æ—¶é—´æ§åˆ¶** | `ä¸šåŠ¡æ—¶é—´æ®µè®¿é—®` | `24å°æ—¶æ— é™åˆ¶è®¿é—®` |

---

## 3. ğŸ” SSL/TLSåŠ å¯†è¿æ¥é…ç½®


### 3.1 SSL/TLSåŠ å¯†çš„ä½œç”¨åŸç†


**åŠ å¯†é€šä¿¡çš„æ¯”å–»**ï¼šå°±åƒä¸¤ä¸ªäººç”¨æš—å·é€šè¯ï¼Œå³ä½¿æœ‰äººå·å¬ä¹Ÿå¬ä¸æ‡‚å†…å®¹ã€‚SSL/TLSå°±æ˜¯æ•°æ®åº“å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„"æš—å·ç³»ç»Ÿ"ã€‚

**SSL/TLSä¿æŠ¤ä»€ä¹ˆ**ï¼š
- **æ•°æ®ä¼ è¾“åŠ å¯†**ï¼šé˜²æ­¢ç½‘ç»œç›‘å¬çªƒå–
- **èº«ä»½éªŒè¯**ï¼šç¡®è®¤æœåŠ¡å™¨çœŸå®æ€§
- **æ•°æ®å®Œæ•´æ€§**ï¼šé˜²æ­¢ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹

```
åŠ å¯†é€šä¿¡æµç¨‹ï¼š
å®¢æˆ·ç«¯                    æ•°æ®åº“æœåŠ¡å™¨
   |                           |
   |--[1]è¯·æ±‚SSLè¿æ¥---------->|
   |<--[2]å‘é€æœåŠ¡å™¨è¯ä¹¦-------|
   |--[3]éªŒè¯è¯ä¹¦ï¼Œç”Ÿæˆå¯†é’¥--->|
   |<--[4]ç¡®è®¤åŠ å¯†è¿æ¥---------|
   |                           |
   |====åŠ å¯†æ•°æ®ä¼ è¾“=========>|
   |<====åŠ å¯†æ•°æ®ä¼ è¾“=========|
```

### 3.2 MySQL SSL/TLSé…ç½®


**ç”ŸæˆSSLè¯ä¹¦**ï¼š
```bash
# ä½¿ç”¨MySQLè‡ªå¸¦å·¥å…·ç”Ÿæˆè¯ä¹¦
sudo mysql_ssl_rsa_setup --uid=mysql

# æˆ–æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦
sudo openssl genrsa 2048 > ca-key.pem
sudo openssl req -new -x509 -nodes -days 3600 -key ca-key.pem -out ca.pem
sudo openssl req -newkey rsa:2048 -days 3600 -nodes -keyout server-key.pem -out server-req.pem
sudo openssl x509 -req -in server-req.pem -days 3600 -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem
```

**é…ç½®MySQLæœåŠ¡å™¨**ï¼š
```bash
# ç¼–è¾‘MySQLé…ç½®æ–‡ä»¶
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

# æ·»åŠ SSLé…ç½®
[mysqld]
ssl-ca=/var/lib/mysql/ca.pem
ssl-cert=/var/lib/mysql/server-cert.pem
ssl-key=/var/lib/mysql/server-key.pem

# è¦æ±‚SSLè¿æ¥
require_secure_transport=ON
```

**é…ç½®ç”¨æˆ·å¼ºåˆ¶SSL**ï¼š
```sql
-- åˆ›å»ºè¦æ±‚SSLè¿æ¥çš„ç”¨æˆ·
CREATE USER 'secureuser'@'%' IDENTIFIED BY 'strong_password' REQUIRE SSL;

-- ä¿®æ”¹ç°æœ‰ç”¨æˆ·è¦æ±‚SSL
ALTER USER 'existinguser'@'%' REQUIRE SSL;

-- æŸ¥çœ‹SSLçŠ¶æ€
SHOW STATUS LIKE 'Ssl_cipher';
SHOW VARIABLES LIKE '%ssl%';
```

**å®¢æˆ·ç«¯SSLè¿æ¥**ï¼š
```bash
# å‘½ä»¤è¡Œè¿æ¥ä½¿ç”¨SSL
mysql -h hostname -u username -p --ssl-mode=REQUIRED

# éªŒè¯SSLè¿æ¥çŠ¶æ€
mysql> \s
# æˆ–è€…
mysql> SHOW STATUS LIKE 'Ssl_cipher';
```

### 3.3 PostgreSQL SSL/TLSé…ç½®


**ç”ŸæˆSSLè¯ä¹¦**ï¼š
```bash
# ç”Ÿæˆç§é’¥
sudo openssl genrsa -out server.key 2048

# ç”Ÿæˆè¯ä¹¦è¯·æ±‚
sudo openssl req -new -key server.key -out server.csr

# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt

# è®¾ç½®æ–‡ä»¶æƒé™
sudo chown postgres:postgres server.key server.crt
sudo chmod 600 server.key
sudo chmod 644 server.crt
```

**é…ç½®PostgreSQLæœåŠ¡å™¨**ï¼š
```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo nano /etc/postgresql/13/main/postgresql.conf

# å¯ç”¨SSL
ssl = on
ssl_cert_file = 'server.crt'
ssl_key_file = 'server.key'
ssl_prefer_server_ciphers = on
ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL'
```

**é…ç½®å®¢æˆ·ç«¯è®¤è¯**ï¼š
```bash
# ç¼–è¾‘pg_hba.conf
sudo nano /etc/postgresql/13/main/pg_hba.conf

# è¦æ±‚SSLè¿æ¥çš„é…ç½®
hostssl  all  all  192.168.1.0/24  md5
host     all  all  192.168.1.0/24  reject
```

**å®¢æˆ·ç«¯SSLè¿æ¥**ï¼š
```bash
# psqlè¿æ¥ä½¿ç”¨SSL
psql "host=hostname dbname=mydb user=myuser sslmode=require"

# éªŒè¯SSLè¿æ¥
SELECT ssl_is_used();
```

### 3.4 SSL/TLSå®‰å…¨é…ç½®å»ºè®®


**è¯ä¹¦ç®¡ç†æœ€ä½³å®è·µ**ï¼š
```
è¯ä¹¦å®‰å…¨è¦ç‚¹ï¼š
ğŸ”‘ ä½¿ç”¨å¼ºå¯†é’¥ï¼šè‡³å°‘2048ä½RSA
ğŸ“… å®šæœŸæ›´æ–°ï¼šè¯ä¹¦æœ‰æ•ˆæœŸä¸è¶…è¿‡2å¹´
ğŸ”’ ç§é’¥ä¿æŠ¤ï¼š600æƒé™ï¼Œä»…æ•°æ®åº“ç”¨æˆ·å¯è¯»
ğŸ¢ è¯ä¹¦æ¥æºï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨CAç­¾å‘è¯ä¹¦
ğŸ“‹ è¯ä¹¦ç›‘æ§ï¼šç›‘æ§è¯ä¹¦è¿‡æœŸæ—¶é—´
```

**SSLé…ç½®ç­‰çº§**ï¼š

| å®‰å…¨ç­‰çº§ | **é…ç½®è¦æ±‚** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| ğŸŸ¢ **åŸºç¡€** | `ssl=on, è‡ªç­¾åè¯ä¹¦` | `å¼€å‘æµ‹è¯•ç¯å¢ƒ` |
| ğŸŸ¡ **æ ‡å‡†** | `require SSL, CAè¯ä¹¦` | `ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒ` |
| ğŸ”´ **ä¸¥æ ¼** | `å®¢æˆ·ç«¯è¯ä¹¦ + æœåŠ¡å™¨è¯ä¹¦` | `é«˜å®‰å…¨è¦æ±‚ç¯å¢ƒ` |

---

## 4. ğŸ”’ æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨


### 4.1 æ•æ„Ÿæ•°æ®åŠ å¯†çš„å¿…è¦æ€§


**ä»€ä¹ˆæ˜¯æ•æ„Ÿæ•°æ®**ï¼šå°±åƒä¸ªäººçš„èº«ä»½è¯å·ã€é“¶è¡Œå¡å·ã€å¯†ç è¿™äº›ä¸èƒ½è®©åˆ«äººçŸ¥é“çš„ä¿¡æ¯ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™äº›æ•°æ®éœ€è¦ç”¨"å¯†ç æœ¬"çš„æ–¹å¼å­˜å‚¨ï¼Œå³ä½¿åäººæ‹¿åˆ°æ•°æ®ä¹Ÿçœ‹ä¸æ‡‚ã€‚

**æ•æ„Ÿæ•°æ®ç±»å‹**ï¼š
- **ä¸ªäººèº«ä»½ä¿¡æ¯**ï¼šèº«ä»½è¯ã€æŠ¤ç…§å·ã€ç¤¾ä¿å·
- **é‡‘èä¿¡æ¯**ï¼šé“¶è¡Œå¡å·ã€æ”¯ä»˜å¯†ç ã€äº¤æ˜“è®°å½•
- **è®¤è¯ä¿¡æ¯**ï¼šç”¨æˆ·å¯†ç ã€APIå¯†é’¥ã€è®¿é—®ä»¤ç‰Œ
- **éšç§ä¿¡æ¯**ï¼šç”µè¯å·ç ã€é‚®ç®±åœ°å€ã€å®¶åº­ä½å€
- **å•†ä¸šæœºå¯†**ï¼šå®¢æˆ·åå•ã€è´¢åŠ¡æ•°æ®ã€æŠ€æœ¯èµ„æ–™

### 4.2 æ•°æ®åŠ å¯†çš„åŸºæœ¬æ–¹å¼


**åŠ å¯†ç±»å‹å¯¹æ¯”**ï¼š
```
å¯¹ç§°åŠ å¯†ï¼ˆAESï¼‰ï¼š
åŠ å¯†è§£å¯†ç”¨åŒä¸€æŠŠé’¥åŒ™ï¼Œé€Ÿåº¦å¿«
é€‚ç”¨ï¼šå¤§é‡æ•°æ®åŠ å¯†

éå¯¹ç§°åŠ å¯†ï¼ˆRSAï¼‰ï¼š
åŠ å¯†è§£å¯†ç”¨ä¸åŒé’¥åŒ™ï¼Œå®‰å…¨æ€§é«˜
é€‚ç”¨ï¼šå¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾å

å“ˆå¸ŒåŠ å¯†ï¼ˆSHA-256ï¼‰ï¼š
å•å‘åŠ å¯†ï¼Œä¸å¯é€†è½¬
é€‚ç”¨ï¼šå¯†ç å­˜å‚¨ã€æ•°æ®æ ¡éªŒ
```

### 4.3 MySQLæ•°æ®åŠ å¯†å®ç°


**AESåŠ å¯†å­˜å‚¨**ï¼š
```sql
-- åˆ›å»ºå¸¦åŠ å¯†å­—æ®µçš„è¡¨
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    email_encrypted VARBINARY(255),
    phone_encrypted VARBINARY(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ’å…¥åŠ å¯†æ•°æ®
INSERT INTO users (username, email_encrypted, phone_encrypted) VALUES
('john_doe', 
 AES_ENCRYPT('john@example.com', 'my_secret_key'),
 AES_ENCRYPT('13800138000', 'my_secret_key'));

-- æŸ¥è¯¢è§£å¯†æ•°æ®
SELECT 
    username,
    AES_DECRYPT(email_encrypted, 'my_secret_key') AS email,
    AES_DECRYPT(phone_encrypted, 'my_secret_key') AS phone
FROM users;
```

**å¯†ç å“ˆå¸Œå­˜å‚¨**ï¼š
```sql
-- åˆ›å»ºç”¨æˆ·è®¤è¯è¡¨
CREATE TABLE user_auth (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    salt VARCHAR(32) NOT NULL
);

-- æ’å…¥å“ˆå¸Œå¯†ç ï¼ˆä½¿ç”¨SHA2å‡½æ•°ï¼‰
SET @password = 'user_password123';
SET @salt = LEFT(UUID(), 8);
INSERT INTO user_auth (username, password_hash, salt) VALUES 
('testuser', SHA2(CONCAT(@password, @salt), 256), @salt);

-- éªŒè¯å¯†ç 
SELECT * FROM user_auth 
WHERE username = 'testuser' 
AND password_hash = SHA2(CONCAT('user_password123', salt), 256);
```

**é€æ˜æ•°æ®åŠ å¯†ï¼ˆTDEï¼‰**ï¼š
```sql
-- å¯ç”¨è¡¨ç©ºé—´åŠ å¯†ï¼ˆMySQL 8.0+ï¼‰
CREATE TABLE sensitive_data (
    id INT PRIMARY KEY,
    credit_card VARBINARY(255),
    ssn VARBINARY(255)
) ENCRYPTION='Y';

-- æŸ¥çœ‹åŠ å¯†çŠ¶æ€
SELECT 
    table_schema,
    table_name,
    create_options
FROM information_schema.tables 
WHERE create_options LIKE '%ENCRYPTION%';
```

### 4.4 PostgreSQLæ•°æ®åŠ å¯†å®ç°


**pgcryptoæ‰©å±•åŠ å¯†**ï¼š
```sql
-- å¯ç”¨pgcryptoæ‰©å±•
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- åˆ›å»ºåŠ å¯†å­˜å‚¨è¡¨
CREATE TABLE customer_data (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    email_encrypted BYTEA,
    credit_card_encrypted BYTEA,
    created_at TIMESTAMP DEFAULT NOW()
);

-- æ’å…¥åŠ å¯†æ•°æ®
INSERT INTO customer_data (name, email_encrypted, credit_card_encrypted) VALUES
('Alice Smith', 
 pgp_sym_encrypt('alice@example.com', 'encryption_key'),
 pgp_sym_encrypt('4532-1234-5678-9012', 'encryption_key'));

-- æŸ¥è¯¢è§£å¯†æ•°æ®
SELECT 
    name,
    pgp_sym_decrypt(email_encrypted, 'encryption_key') AS email,
    pgp_sym_decrypt(credit_card_encrypted, 'encryption_key') AS credit_card
FROM customer_data;
```

**å¯†ç å®‰å…¨å­˜å‚¨**ï¼š
```sql
-- åˆ›å»ºè®¤è¯è¡¨
CREATE TABLE user_accounts (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- æ’å…¥bcryptå“ˆå¸Œå¯†ç 
INSERT INTO user_accounts (username, password_hash) VALUES
('user1', crypt('mypassword123', gen_salt('bf', 12)));

-- éªŒè¯å¯†ç 
SELECT * FROM user_accounts 
WHERE username = 'user1' 
AND password_hash = crypt('mypassword123', password_hash);
```

### 4.5 åŠ å¯†å¯†é’¥ç®¡ç†


**å¯†é’¥ç®¡ç†åŸåˆ™**ï¼š
```
å¯†é’¥å®‰å…¨è¦ç‚¹ï¼š
ğŸ” å¯†é’¥åˆ†ç¦»ï¼šåŠ å¯†å¯†é’¥ä¸å­˜å‚¨åœ¨æ•°æ®åº“ä¸­
ğŸ”„ å¯†é’¥è½®æ¢ï¼šå®šæœŸæ›´æ¢åŠ å¯†å¯†é’¥
ğŸ‘¥ æƒé™æ§åˆ¶ï¼šé™åˆ¶å¯†é’¥è®¿é—®äººå‘˜
ğŸ“¦ å¯†é’¥å¤‡ä»½ï¼šå®‰å…¨å¤‡ä»½å¯†é’¥åˆ°ç¦»çº¿å­˜å‚¨
ğŸ” å¯†é’¥å®¡è®¡ï¼šè®°å½•å¯†é’¥ä½¿ç”¨æƒ…å†µ
```

**å¯†é’¥å­˜å‚¨æ–¹æ¡ˆ**ï¼š

| å­˜å‚¨æ–¹å¼ | **å®‰å…¨ç­‰çº§** | **å¤æ‚åº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-----------|-------------|
| ğŸ”§ **ç¯å¢ƒå˜é‡** | `ä¸­ç­‰` | `ç®€å•` | `å¼€å‘æµ‹è¯•ç¯å¢ƒ` |
| ğŸ“ **é…ç½®æ–‡ä»¶** | `ä¸­ç­‰` | `ç®€å•` | `å°å‹åº”ç”¨` |
| ğŸª **å¯†é’¥ç®¡ç†æœåŠ¡** | `é«˜` | `å¤æ‚` | `ç”Ÿäº§ç¯å¢ƒ` |
| ğŸ”’ **ç¡¬ä»¶å®‰å…¨æ¨¡å—** | `æé«˜` | `å¤æ‚` | `é‡‘èã€æ”¿åºœæœºæ„` |

**å¯†é’¥è½®æ¢ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# å¯†é’¥è½®æ¢è„šæœ¬ç¤ºä¾‹

# ç”Ÿæˆæ–°å¯†é’¥
NEW_KEY=$(openssl rand -hex 32)

# å¤‡ä»½å½“å‰å¯†é’¥
cp current_key.txt backup_key_$(date +%Y%m%d).txt

# é‡æ–°åŠ å¯†æ•°æ®ï¼ˆä½¿ç”¨æ–°å¯†é’¥ï¼‰
mysql -u root -p << EOF
UPDATE sensitive_table SET 
encrypted_field = AES_ENCRYPT(
    AES_DECRYPT(encrypted_field, '$OLD_KEY'), 
    '$NEW_KEY'
);
EOF

# æ›´æ–°å¯†é’¥æ–‡ä»¶
echo "$NEW_KEY" > current_key.txt
```

---

## 5. ğŸ“Š å®¡è®¡æ—¥å¿—é…ç½®ä¸åˆ†æ


### 5.1 æ•°æ®åº“å®¡è®¡æ—¥å¿—çš„ä½œç”¨


**å®¡è®¡æ—¥å¿—çš„æ¯”å–»**ï¼šå°±åƒé“¶è¡Œçš„ç›‘æ§å½•åƒï¼Œè®°å½•è°ä»€ä¹ˆæ—¶å€™è¿›å…¥äº†ä¿é™©åº“ï¼Œæ‹¿äº†ä»€ä¹ˆä¸œè¥¿ã€‚æ•°æ®åº“å®¡è®¡æ—¥å¿—è®°å½•æ‰€æœ‰å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œæ–¹ä¾¿äº‹åè¿½è¸ªå’Œåˆ†æã€‚

**å®¡è®¡æ—¥å¿—è®°å½•ä»€ä¹ˆ**ï¼š
- **è°æ“ä½œ**ï¼šç”¨æˆ·åã€IPåœ°å€ã€è¿æ¥ä¿¡æ¯
- **ä»€ä¹ˆæ—¶å€™**ï¼šç²¾ç¡®çš„æ“ä½œæ—¶é—´æˆ³
- **åšäº†ä»€ä¹ˆ**ï¼šæ‰§è¡Œçš„SQLè¯­å¥ã€æ“ä½œç±»å‹
- **æ“ä½œç»“æœ**ï¼šæˆåŠŸè¿˜æ˜¯å¤±è´¥ã€å½±å“è¡Œæ•°
- **æ•°æ®å˜åŒ–**ï¼šä¿®æ”¹å‰åçš„æ•°æ®å¯¹æ¯”

### 5.2 MySQLå®¡è®¡æ—¥å¿—é…ç½®


**å¯ç”¨é€šç”¨æŸ¥è¯¢æ—¥å¿—**ï¼š
```sql
-- æŸ¥çœ‹æ—¥å¿—é…ç½®çŠ¶æ€
SHOW VARIABLES LIKE '%log%';

-- å¯ç”¨é€šç”¨æŸ¥è¯¢æ—¥å¿—
SET GLOBAL general_log = 'ON';
SET GLOBAL general_log_file = '/var/log/mysql/general.log';

-- æ°¸ä¹…é…ç½®ï¼ˆç¼–è¾‘my.cnfï¼‰
[mysqld]
general_log = 1
general_log_file = /var/log/mysql/general.log
```

**å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—**ï¼š
```sql
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL slow_query_log_file = '/var/log/mysql/slow.log';
SET GLOBAL long_query_time = 2;  -- è¶…è¿‡2ç§’çš„æŸ¥è¯¢

-- é…ç½®æ–‡ä»¶è®¾ç½®
[mysqld]
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1
```

**å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—**ï¼š
```bash
# ç¼–è¾‘MySQLé…ç½®æ–‡ä»¶
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

# æ·»åŠ äºŒè¿›åˆ¶æ—¥å¿—é…ç½®
[mysqld]
log-bin = /var/log/mysql/mysql-bin
server-id = 1
binlog_format = ROW
expire_logs_days = 7
```

**å®¡è®¡æ’ä»¶é…ç½®ï¼ˆMySQL Enterpriseï¼‰**ï¼š
```sql
-- å®‰è£…å®¡è®¡æ’ä»¶
INSTALL PLUGIN audit_log SONAME 'audit_log.so';

-- é…ç½®å®¡è®¡ç­–ç•¥
SET GLOBAL audit_log_policy = 'ALL';
SET GLOBAL audit_log_file = '/var/log/mysql/audit.log';

-- æŸ¥çœ‹å®¡è®¡é…ç½®
SHOW VARIABLES LIKE 'audit_log%';
```

### 5.3 PostgreSQLå®¡è®¡æ—¥å¿—é…ç½®


**åŸºç¡€æ—¥å¿—é…ç½®**ï¼š
```bash
# ç¼–è¾‘postgresql.conf
sudo nano /etc/postgresql/13/main/postgresql.conf

# å¯ç”¨æ—¥å¿—è®°å½•
logging_collector = on
log_directory = '/var/log/postgresql'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB

# è®°å½•è¿æ¥ä¿¡æ¯
log_connections = on
log_disconnections = on
log_hostname = on

# è®°å½•SQLè¯­å¥
log_statement = 'all'              # è®°å½•æ‰€æœ‰è¯­å¥
log_min_duration_statement = 1000  # è®°å½•è¶…è¿‡1ç§’çš„è¯­å¥
```

**è¯¦ç»†å®¡è®¡é…ç½®**ï¼š
```bash
# å®¡è®¡ç›¸å…³é…ç½®
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_lock_waits = on
log_temp_files = 0
log_autovacuum_min_duration = 0

# è®°å½•DDLæ“ä½œ
log_statement = 'ddl'  # åªè®°å½•DDLè¯­å¥
# log_statement = 'mod'  # è®°å½•DDLå’ŒDMLè¯­å¥
# log_statement = 'all'  # è®°å½•æ‰€æœ‰è¯­å¥
```

**pgAuditæ‰©å±•**ï¼š
```bash
# å®‰è£…pgAuditæ‰©å±•
sudo apt-get install postgresql-13-pgaudit

# é…ç½®postgresql.conf
shared_preload_libraries = 'pgaudit'
pgaudit.log = 'all'
pgaudit.log_catalog = off
pgaudit.log_parameter = on
pgaudit.log_relation = on
pgaudit.log_statement_once = on
```

```sql
-- åœ¨æ•°æ®åº“ä¸­å¯ç”¨pgAudit
CREATE EXTENSION pgaudit;

-- è®¾ç½®å®¡è®¡ç­–ç•¥
ALTER SYSTEM SET pgaudit.log = 'ddl,write,read';
SELECT pg_reload_conf();

-- æŸ¥çœ‹å®¡è®¡é…ç½®
SHOW pgaudit.log;
```

### 5.4 å®¡è®¡æ—¥å¿—åˆ†æ


**æ—¥å¿—åˆ†æè„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# MySQLå®¡è®¡æ—¥å¿—åˆ†æè„šæœ¬

LOG_FILE="/var/log/mysql/general.log"
DATE=$(date +%Y-%m-%d)

echo "=== MySQLå®¡è®¡æ—¥å¿—åˆ†ææŠ¥å‘Š ($DATE) ==="

# ç»Ÿè®¡è¿æ¥æ¬¡æ•°æœ€å¤šçš„IP
echo "è¿æ¥æ¬¡æ•°æœ€å¤šçš„IPåœ°å€ï¼š"
grep "Connect" $LOG_FILE | grep $DATE | \
awk '{print $5}' | sort | uniq -c | sort -nr | head -10

# ç»Ÿè®¡æ‰§è¡Œæœ€å¤šçš„SQLç±»å‹
echo "æ‰§è¡Œæœ€å¤šçš„SQLæ“ä½œç±»å‹ï¼š"
grep "Query" $LOG_FILE | grep $DATE | \
awk '{print $6}' | sort | uniq -c | sort -nr | head -10

# æŸ¥æ‰¾å¤±è´¥çš„ç™»å½•å°è¯•
echo "å¤±è´¥çš„ç™»å½•å°è¯•ï¼š"
grep "Access denied" $LOG_FILE | grep $DATE | wc -l

# æŸ¥æ‰¾å¯ç–‘çš„æ“ä½œ
echo "å¯ç–‘çš„DROPæ“ä½œï¼š"
grep -i "drop\|delete\|truncate" $LOG_FILE | grep $DATE
```

**PostgreSQLæ—¥å¿—åˆ†æ**ï¼š
```bash
#!/bin/bash
# PostgreSQLå®¡è®¡æ—¥å¿—åˆ†æ

LOG_DIR="/var/log/postgresql"
TODAY=$(date +%Y-%m-%d)

echo "=== PostgreSQLå®¡è®¡æ—¥å¿—åˆ†æ ($TODAY) ==="

# åˆ†æè¿æ¥ç»Ÿè®¡
echo "ä»Šæ—¥è¿æ¥ç»Ÿè®¡ï¼š"
grep "connection authorized" $LOG_DIR/postgresql-$TODAY*.log | \
awk '{print $8}' | sort | uniq -c | sort -nr

# æŸ¥æ‰¾é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
echo "é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢ï¼š"
grep "duration:" $LOG_DIR/postgresql-$TODAY*.log | \
awk '{print $4, $5, $6}' | sort -nr | head -10

# æŸ¥æ‰¾é”™è¯¯å’Œå¼‚å¸¸
echo "é”™è¯¯ç»Ÿè®¡ï¼š"
grep "ERROR\|FATAL" $LOG_DIR/postgresql-$TODAY*.log | \
awk '{print $4}' | sort | uniq -c | sort -nr
```

### 5.5 å®¡è®¡æ—¥å¿—ç®¡ç†æœ€ä½³å®è·µ


**æ—¥å¿—è½®æ¢é…ç½®**ï¼š
```bash
# åˆ›å»ºlogrotateé…ç½®æ–‡ä»¶
sudo nano /etc/logrotate.d/mysql-audit

/var/log/mysql/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 640 mysql mysql
    postrotate
        /usr/bin/mysql -e 'select $$global.read_only as ro;' | grep -q 'ON' || /usr/bin/mysql -e 'flush logs'
    endscript
}
```

**å®¡è®¡å‘Šè­¦è®¾ç½®**ï¼š
```bash
#!/bin/bash
# å®¡è®¡å‘Šè­¦è„šæœ¬

# æ£€æŸ¥å¼‚å¸¸ç™»å½•
FAILED_LOGINS=$(grep "Access denied" /var/log/mysql/general.log | \
tail -100 | wc -l)

if [ $FAILED_LOGINS -gt 10 ]; then
    echo "è­¦å‘Šï¼šæ£€æµ‹åˆ°å¼‚å¸¸ç™»å½•å°è¯• $FAILED_LOGINS æ¬¡" | \
    mail -s "æ•°æ®åº“å®‰å…¨å‘Šè­¦" admin@company.com
fi

# æ£€æŸ¥å±é™©æ“ä½œ
DANGEROUS_OPS=$(grep -i "drop\|delete.*where.*1=1\|truncate" \
/var/log/mysql/general.log | tail -10 | wc -l)

if [ $DANGEROUS_OPS -gt 0 ]; then
    echo "è­¦å‘Šï¼šæ£€æµ‹åˆ°å±é™©çš„æ•°æ®åº“æ“ä½œ" | \
    mail -s "æ•°æ®åº“æ“ä½œå‘Šè­¦" admin@company.com
fi
```

---

## 6. ğŸ”„ å®šæœŸå®‰å…¨æ›´æ–°ä¸è¡¥ä¸


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦å®šæœŸå®‰å…¨æ›´æ–°


**å®‰å…¨æ›´æ–°çš„é‡è¦æ€§**ï¼šå°±åƒç»™ç”µè„‘å®‰è£…æ€æ¯’è½¯ä»¶æ›´æ–°ä¸€æ ·ï¼Œæ•°æ®åº“ä¹Ÿéœ€è¦å®šæœŸ"æ‰“è¡¥ä¸"æ¥ä¿®å¤å‘ç°çš„å®‰å…¨æ¼æ´ï¼Œé˜²æ­¢é»‘å®¢åˆ©ç”¨è¿™äº›æ¼æ´æ”»å‡»ç³»ç»Ÿã€‚

**ä¸æ›´æ–°çš„é£é™©**ï¼š
- **å·²çŸ¥æ¼æ´æš´éœ²**ï¼šé»‘å®¢åˆ©ç”¨å…¬å¼€æ¼æ´æ”»å‡»
- **é›¶æ—¥æ”»å‡»**ï¼šæ–°å‘ç°çš„æ¼æ´è¢«æ¶æ„åˆ©ç”¨
- **åˆè§„é—®é¢˜**ï¼šä¸ç¬¦åˆå®‰å…¨æ ‡å‡†è¦æ±‚
- **ç¨³å®šæ€§é—®é¢˜**ï¼šBugå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ

### 6.2 MySQLå®‰å…¨æ›´æ–°ç®¡ç†


**æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ä¿¡æ¯**ï¼š
```sql
-- æŸ¥çœ‹MySQLç‰ˆæœ¬
SELECT VERSION();

-- æŸ¥çœ‹è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯
SHOW VARIABLES LIKE 'version%';

-- æŸ¥çœ‹ç¼–è¯‘ä¿¡æ¯
SHOW VARIABLES LIKE 'version_compile%';
```

**Ubuntu/Debianæ›´æ–°MySQL**ï¼š
```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# æŸ¥çœ‹å¯ç”¨çš„MySQLæ›´æ–°
sudo apt list --upgradable | grep mysql

# å¤‡ä»½é…ç½®æ–‡ä»¶
sudo cp /etc/mysql/mysql.conf.d/mysqld.cnf /etc/mysql/mysql.conf.d/mysqld.cnf.backup

# å¤‡ä»½æ•°æ®åº“
sudo mysqldump --all-databases --single-transaction --routines --triggers > backup_before_update.sql

# æ›´æ–°MySQL
sudo apt upgrade mysql-server mysql-client

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status mysql

# è¿è¡Œå‡çº§è„šæœ¬
sudo mysql_upgrade
```

**CentOS/RHELæ›´æ–°MySQL**ï¼š
```bash
# ä½¿ç”¨yumæ›´æ–°
sudo yum update mysql-server mysql

# æˆ–ä½¿ç”¨dnfï¼ˆæ–°ç‰ˆæœ¬ï¼‰
sudo dnf update mysql-server mysql

# é‡å¯æœåŠ¡
sudo systemctl restart mysqld

# æ£€æŸ¥ç‰ˆæœ¬
mysql --version
```

### 6.3 PostgreSQLå®‰å…¨æ›´æ–°ç®¡ç†


**æŸ¥çœ‹å½“å‰ç‰ˆæœ¬**ï¼š
```sql
-- æŸ¥çœ‹PostgreSQLç‰ˆæœ¬
SELECT version();

-- æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
SELECT current_setting('server_version');
SELECT current_setting('server_version_num');
```

**Ubuntu/Debianæ›´æ–°PostgreSQL**ï¼š
```bash
# æ›´æ–°è½¯ä»¶åŒ…
sudo apt update

# æŸ¥çœ‹å¯ç”¨æ›´æ–°
sudo apt list --upgradable | grep postgresql

# å¤‡ä»½é›†ç¾¤
sudo -u postgres pg_dumpall > backup_before_update.sql

# æ›´æ–°PostgreSQL
sudo apt upgrade postgresql postgresql-client

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status postgresql
```

**ä¸»ç‰ˆæœ¬å‡çº§ï¼ˆPostgreSQLï¼‰**ï¼š
```bash
# å®‰è£…æ–°ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ä»12å‡çº§åˆ°13ï¼‰
sudo apt install postgresql-13 postgresql-client-13

# åœæ­¢æ‰€æœ‰PostgreSQLæœåŠ¡
sudo systemctl stop postgresql

# ä½¿ç”¨pg_upgradeå‡çº§
sudo -u postgres /usr/lib/postgresql/13/bin/pg_upgrade \
  --old-datadir=/var/lib/postgresql/12/main \
  --new-datadir=/var/lib/postgresql/13/main \
  --old-bindir=/usr/lib/postgresql/12/bin \
  --new-bindir=/usr/lib/postgresql/13/bin \
  --check

# å®é™…æ‰§è¡Œå‡çº§
sudo -u postgres /usr/lib/postgresql/13/bin/pg_upgrade \
  --old-datadir=/var/lib/postgresql/12/main \
  --new-datadir=/var/lib/postgresql/13/main \
  --old-bindir=/usr/lib/postgresql/12/bin \
  --new-bindir=/usr/lib/postgresql/13/bin

# å¯åŠ¨æ–°ç‰ˆæœ¬
sudo systemctl start postgresql
```

### 6.4 å®‰å…¨æ›´æ–°æµç¨‹åˆ¶å®š


**æ›´æ–°å‰å‡†å¤‡æ¸…å•**ï¼š
```
æ›´æ–°å‰å¿…åšäº‹é¡¹ï¼š
â˜‘ï¸ å®Œæ•´æ•°æ®å¤‡ä»½
â˜‘ï¸ é…ç½®æ–‡ä»¶å¤‡ä»½
â˜‘ï¸ æµ‹è¯•ç¯å¢ƒéªŒè¯
â˜‘ï¸ æ›´æ–°æ—¶é—´è§„åˆ’
â˜‘ï¸ å›æ»šè®¡åˆ’å‡†å¤‡
â˜‘ï¸ ç›¸å…³äººå‘˜é€šçŸ¥
â˜‘ï¸ ä¸šåŠ¡å½±å“è¯„ä¼°
```

**è‡ªåŠ¨åŒ–æ›´æ–°è„šæœ¬**ï¼š
```bash
#!/bin/bash
# MySQLè‡ªåŠ¨åŒ–å®‰å…¨æ›´æ–°è„šæœ¬

LOG_FILE="/var/log/mysql_update.log"
BACKUP_DIR="/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)

echo "$(date): å¼€å§‹MySQLå®‰å…¨æ›´æ–°" >> $LOG_FILE

# 1. åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR/$DATE

# 2. å¤‡ä»½æ•°æ®åº“
echo "$(date): å¼€å§‹æ•°æ®å¤‡ä»½" >> $LOG_FILE
mysqldump --all-databases --single-transaction --routines --triggers \
  > $BACKUP_DIR/$DATE/full_backup.sql

if [ $? -eq 0 ]; then
    echo "$(date): æ•°æ®å¤‡ä»½æˆåŠŸ" >> $LOG_FILE
else
    echo "$(date): æ•°æ®å¤‡ä»½å¤±è´¥ï¼Œåœæ­¢æ›´æ–°" >> $LOG_FILE
    exit 1
fi

# 3. å¤‡ä»½é…ç½®æ–‡ä»¶
cp /etc/mysql/mysql.conf.d/mysqld.cnf $BACKUP_DIR/$DATE/

# 4. æ£€æŸ¥å¯ç”¨æ›´æ–°
apt list --upgradable | grep mysql > $BACKUP_DIR/$DATE/available_updates.txt

# 5. æ‰§è¡Œæ›´æ–°
echo "$(date): å¼€å§‹æ‰§è¡Œæ›´æ–°" >> $LOG_FILE
apt update && apt upgrade -y mysql-server mysql-client

# 6. é‡å¯æœåŠ¡
systemctl restart mysql

# 7. éªŒè¯æœåŠ¡çŠ¶æ€
if systemctl is-active --quiet mysql; then
    echo "$(date): MySQLæœåŠ¡æ­£å¸¸è¿è¡Œ" >> $LOG_FILE
    mysql -e "SELECT VERSION();" >> $LOG_FILE
else
    echo "$(date): MySQLæœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œå¼€å§‹å›æ»š" >> $LOG_FILE
    # å›æ»šé€»è¾‘
    systemctl stop mysql
    # æ¢å¤é…ç½®å’Œæ•°æ®
    echo "$(date): è¯·æ‰‹åŠ¨æ£€æŸ¥å¹¶æ¢å¤ç³»ç»Ÿ" >> $LOG_FILE
fi

echo "$(date): MySQLæ›´æ–°å®Œæˆ" >> $LOG_FILE
```

### 6.5 æ›´æ–°ç­–ç•¥åˆ¶å®š


**æ›´æ–°é¢‘ç‡å»ºè®®**ï¼š

| æ›´æ–°ç±»å‹ | **é¢‘ç‡** | **æ—¶æœº** | **æµ‹è¯•è¦æ±‚** |
|---------|---------|---------|-------------|
| ğŸ”´ **ç´§æ€¥å®‰å…¨è¡¥ä¸** | `ç«‹å³` | `å‘å¸ƒå24å°æ—¶å†…` | `åŸºç¡€åŠŸèƒ½æµ‹è¯•` |
| ğŸŸ¡ **å¸¸è§„å®‰å…¨æ›´æ–°** | `æœˆåº¦` | `æ¯æœˆç»´æŠ¤çª—å£` | `å®Œæ•´å›å½’æµ‹è¯•` |
| ğŸŸ¢ **åŠŸèƒ½æ›´æ–°** | `å­£åº¦` | `è®¡åˆ’ç»´æŠ¤æœŸ` | `å…¨é¢å…¼å®¹æ€§æµ‹è¯•` |
| ğŸ”µ **ä¸»ç‰ˆæœ¬å‡çº§** | `å¹´åº¦` | `é‡å¤§ç»´æŠ¤æœŸ` | `å®Œæ•´ç³»ç»Ÿæµ‹è¯•` |

**æ›´æ–°æµ‹è¯•æµç¨‹**ï¼š
```
æ›´æ–°æµ‹è¯•æ­¥éª¤ï¼š
ğŸ”¸ å¼€å‘ç¯å¢ƒéªŒè¯ï¼šåŠŸèƒ½æµ‹è¯• + æ€§èƒ½æµ‹è¯•
ğŸ”¸ æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼šé›†æˆæµ‹è¯• + ç”¨æˆ·éªŒæ”¶æµ‹è¯•
ğŸ”¸ é¢„ç”Ÿäº§éªŒè¯ï¼šå®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
ğŸ”¸ ç”Ÿäº§ç¯å¢ƒæ›´æ–°ï¼šåˆ†æ‰¹æ›´æ–° + å®æ—¶ç›‘æ§
ğŸ”¸ æ›´æ–°åéªŒè¯ï¼šä¸šåŠ¡åŠŸèƒ½éªŒè¯ + æ€§èƒ½ç›‘æ§
```

---

## 7. ğŸ” æ•°æ®åº“æ–‡ä»¶æƒé™åŠ å›º


### 7.1 æ•°æ®åº“æ–‡ä»¶æƒé™çš„é‡è¦æ€§


**æ–‡ä»¶æƒé™ä¿æŠ¤åŸç†**ï¼šå°±åƒä¿é™©ç®±çš„é’¥åŒ™ç®¡ç†ï¼Œåªæœ‰ç‰¹å®šçš„äººï¼ˆç”¨æˆ·ï¼‰å¯ä»¥æ‰“å¼€ç‰¹å®šçš„ç®±å­ï¼ˆæ–‡ä»¶ï¼‰ã€‚æ•°æ®åº“æ–‡ä»¶æƒé™æ§åˆ¶å“ªäº›ç³»ç»Ÿç”¨æˆ·å¯ä»¥è¯»å–ã€ä¿®æ”¹æ•°æ®åº“æ–‡ä»¶ã€‚

**éœ€è¦ä¿æŠ¤çš„æ–‡ä»¶ç±»å‹**ï¼š
- **æ•°æ®æ–‡ä»¶**ï¼šå­˜å‚¨å®é™…æ•°æ®çš„æ–‡ä»¶
- **æ—¥å¿—æ–‡ä»¶**ï¼šäº‹åŠ¡æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€å®¡è®¡æ—¥å¿—
- **é…ç½®æ–‡ä»¶**ï¼šæ•°æ®åº“é…ç½®ã€å¯†ç æ–‡ä»¶
- **å¤‡ä»½æ–‡ä»¶**ï¼šæ•°æ®åº“å¤‡ä»½ã€å½’æ¡£æ–‡ä»¶
- **ä¸´æ—¶æ–‡ä»¶**ï¼šæŸ¥è¯¢ä¸´æ—¶æ–‡ä»¶ã€æ’åºæ–‡ä»¶

### 7.2 Linuxæ–‡ä»¶æƒé™åŸºç¡€


**æƒé™è¡¨ç¤ºæ³•**ï¼š
```
æƒé™ä½è¯´æ˜ï¼š
rwx rwx rwx
â”œâ”€â”€ â”œâ”€â”€ â””â”€â”€ å…¶ä»–ç”¨æˆ·æƒé™
â”œâ”€â”€ â””â”€â”€ ç»„ç”¨æˆ·æƒé™  
â””â”€â”€ æ–‡ä»¶æ‰€æœ‰è€…æƒé™

æƒé™å«ä¹‰ï¼š
r (read)    = 4  : è¯»å–æƒé™
w (write)   = 2  : å†™å…¥æƒé™  
x (execute) = 1  : æ‰§è¡Œæƒé™

ç¤ºä¾‹ï¼š
755 = rwxr-xr-x  æ‰€æœ‰è€…å¯è¯»å†™æ‰§è¡Œï¼Œç»„å’Œå…¶ä»–ç”¨æˆ·å¯è¯»æ‰§è¡Œ
600 = rw-------  åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
644 = rw-r--r--  æ‰€æœ‰è€…å¯è¯»å†™ï¼Œç»„å’Œå…¶ä»–ç”¨æˆ·åªè¯»
```

**æƒé™æŸ¥çœ‹å’Œä¿®æ”¹**ï¼š
```bash
# æŸ¥çœ‹æ–‡ä»¶æƒé™
ls -la /var/lib/mysql/

# ä¿®æ”¹æ–‡ä»¶æƒé™
chmod 600 /var/lib/mysql/my.cnf  # åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
chmod 755 /var/lib/mysql/        # ç›®å½•æƒé™

# ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…
chown mysql:mysql /var/lib/mysql/data.frm

# é€’å½’ä¿®æ”¹æƒé™
chmod -R 700 /var/lib/mysql/
chown -R mysql:mysql /var/lib/mysql/
```

### 7.3 MySQLæ–‡ä»¶æƒé™åŠ å›º


**MySQLç›®å½•ç»“æ„å’Œæƒé™**ï¼š
```bash
# æŸ¥çœ‹MySQLæ–‡ä»¶æƒé™
ls -la /var/lib/mysql/

# æ ‡å‡†MySQLæ–‡ä»¶æƒé™è®¾ç½®
# æ•°æ®ç›®å½•
chmod 700 /var/lib/mysql/
chown mysql:mysql /var/lib/mysql/

# æ•°æ®æ–‡ä»¶
find /var/lib/mysql/ -name "*.frm" -exec chmod 660 {} \;
find /var/lib/mysql/ -name "*.ibd" -exec chmod 660 {} \;
find /var/lib/mysql/ -name "*.MYD" -exec chmod 660 {} \;
find /var/lib/mysql/ -name "*.MYI" -exec chmod 660 {} \;

# æ—¥å¿—æ–‡ä»¶
chmod 640 /var/log/mysql/*.log
chown mysql:adm /var/log/mysql/*.log

# é…ç½®æ–‡ä»¶
chmod 644 /etc/mysql/mysql.conf.d/mysqld.cnf
chown root:root /etc/mysql/mysql.conf.d/mysqld.cnf
```

**MySQLæƒé™åŠ å›ºè„šæœ¬**ï¼š
```bash
#!/bin/bash
# MySQLæ–‡ä»¶æƒé™åŠ å›ºè„šæœ¬

MYSQL_DATA_DIR="/var/lib/mysql"
MYSQL_LOG_DIR="/var/log/mysql"
MYSQL_CONF_DIR="/etc/mysql"

echo "å¼€å§‹MySQLæ–‡ä»¶æƒé™åŠ å›º..."

# 1. è®¾ç½®æ•°æ®ç›®å½•æƒé™
echo "è®¾ç½®æ•°æ®ç›®å½•æƒé™..."
chmod 700 $MYSQL_DATA_DIR
chown mysql:mysql $MYSQL_DATA_DIR

# 2. è®¾ç½®æ•°æ®æ–‡ä»¶æƒé™
echo "è®¾ç½®æ•°æ®æ–‡ä»¶æƒé™..."
find $MYSQL_DATA_DIR -type f -name "*.frm" -exec chmod 660 {} \;
find $MYSQL_DATA_DIR -type f -name "*.ibd" -exec chmod 660 {} \;
find $MYSQL_DATA_DIR -type f -name "*.MYD" -exec chmod 660 {} \;
find $MYSQL_DATA_DIR -type f -name "*.MYI" -exec chmod 660 {} \;
find $MYSQL_DATA_DIR -type f -exec chown mysql:mysql {} \;

# 3. è®¾ç½®æ—¥å¿—æ–‡ä»¶æƒé™
echo "è®¾ç½®æ—¥å¿—æ–‡ä»¶æƒé™..."
if [ -d $MYSQL_LOG_DIR ]; then
    chmod 750 $MYSQL_LOG_DIR
    chmod 640 $MYSQL_LOG_DIR/*.log 2>/dev/null
    chown mysql:adm $MYSQL_LOG_DIR/*.log 2>/dev/null
fi

# 4. è®¾ç½®é…ç½®æ–‡ä»¶æƒé™
echo "è®¾ç½®é…ç½®æ–‡ä»¶æƒé™..."
find $MYSQL_CONF_DIR -name "*.cnf" -exec chmod 644 {} \;
find $MYSQL_CONF_DIR -name "*.cnf" -exec chown root:root {} \;

# 5. æ£€æŸ¥ç‰¹æ®Šæƒé™
echo "æ£€æŸ¥ç‰¹æ®Šæƒé™..."
find $MYSQL_DATA_DIR -perm /o+rwx -ls
find $MYSQL_DATA_DIR -perm /g+w -ls

echo "MySQLæ–‡ä»¶æƒé™åŠ å›ºå®Œæˆï¼"
```

### 7.4 PostgreSQLæ–‡ä»¶æƒé™åŠ å›º


**PostgreSQLç›®å½•ç»“æ„å’Œæƒé™**ï¼š
```bash
# æŸ¥çœ‹PostgreSQLæ–‡ä»¶æƒé™
ls -la /var/lib/postgresql/13/main/

# PostgreSQLæ ‡å‡†æƒé™è®¾ç½®
# æ•°æ®ç›®å½•
chmod 700 /var/lib/postgresql/13/main/
chown postgres:postgres /var/lib/postgresql/13/main/

# é…ç½®æ–‡ä»¶
chmod 600 /etc/postgresql/13/main/postgresql.conf
chmod 600 /etc/postgresql/13/main/pg_hba.conf
chown postgres:postgres /etc/postgresql/13/main/*.conf

# æ—¥å¿—ç›®å½•
chmod 750 /var/log/postgresql/
chmod 640 /var/log/postgresql/*.log
chown postgres:adm /var/log/postgresql/*.log
```

**PostgreSQLæƒé™åŠ å›ºè„šæœ¬**ï¼š
```bash
#!/bin/bash
# PostgreSQLæ–‡ä»¶æƒé™åŠ å›ºè„šæœ¬

PG_VERSION="13"
PG_DATA_DIR="/var/lib/postgresql/$PG_VERSION/main"
PG_CONF_DIR="/etc/postgresql/$PG_VERSION/main"
PG_LOG_DIR="/var/log/postgresql"

echo "å¼€å§‹PostgreSQLæ–‡ä»¶æƒé™åŠ å›º..."

# 1. è®¾ç½®æ•°æ®ç›®å½•æƒé™
echo "è®¾ç½®æ•°æ®ç›®å½•æƒé™..."
chmod 700 $PG_DATA_DIR
chown postgres:postgres $PG_DATA_DIR

# 2. è®¾ç½®æ•°æ®æ–‡ä»¶æƒé™
echo "è®¾ç½®æ•°æ®æ–‡ä»¶æƒé™..."
find $PG_DATA_DIR -type f -exec chmod 600 {} \;
find $PG_DATA_DIR -type d -exec chmod 700 {} \;
find $PG_DATA_DIR -exec chown postgres:postgres {} \;

# 3. è®¾ç½®é…ç½®æ–‡ä»¶æƒé™
echo "è®¾ç½®é…ç½®æ–‡ä»¶æƒé™..."
chmod 600 $PG_CONF_DIR/postgresql.conf
chmod 600 $PG_CONF_DIR/pg_hba.conf
chmod 600 $PG_CONF_DIR/pg_ident.conf
chown postgres:postgres $PG_CONF_DIR/*.conf

# 4. è®¾ç½®æ—¥å¿—æ–‡ä»¶æƒé™
echo "è®¾ç½®æ—¥å¿—æ–‡ä»¶æƒé™..."
if [ -d $PG_LOG_DIR ]; then
    chmod 750 $PG_LOG_DIR
    chmod 640 $PG_LOG_DIR/*.log 2>/dev/null
    chown postgres:adm $PG_LOG_DIR 2>/dev/null
fi

# 5. ç§»é™¤å…¶ä»–ç”¨æˆ·æƒé™
echo "ç§»é™¤å…¶ä»–ç”¨æˆ·æƒé™..."
find $PG_DATA_DIR -perm /o+rwx -exec chmod o-rwx {} \;

echo "PostgreSQLæ–‡ä»¶æƒé™åŠ å›ºå®Œæˆï¼"
```

### 7.5 æƒé™å®¡è®¡å’Œç›‘æ§


**æƒé™æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æ•°æ®åº“æ–‡ä»¶æƒé™å®¡è®¡è„šæœ¬

echo "=== æ•°æ®åº“æ–‡ä»¶æƒé™å®¡è®¡æŠ¥å‘Š ==="
echo "å®¡è®¡æ—¶é—´: $(date)"

# æ£€æŸ¥MySQLæƒé™
if [ -d "/var/lib/mysql" ]; then
    echo ""
    echo "MySQLæƒé™æ£€æŸ¥:"
    echo "æ•°æ®ç›®å½•æƒé™:"
    ls -ld /var/lib/mysql/
    
    echo "å‘ç°çš„æƒé™é—®é¢˜:"
    find /var/lib/mysql -perm /o+rwx -ls 2>/dev/null | head -5
    
    echo "é…ç½®æ–‡ä»¶æƒé™:"
    ls -l /etc/mysql/mysql.conf.d/mysqld.cnf 2>/dev/null
fi

# æ£€æŸ¥PostgreSQLæƒé™  
if [ -d "/var/lib/postgresql" ]; then
    echo ""
    echo "PostgreSQLæƒé™æ£€æŸ¥:"
    echo "æ•°æ®ç›®å½•æƒé™:"
    ls -ld /var/lib/postgresql/*/main/ 2>/dev/null
    
    echo "é…ç½®æ–‡ä»¶æƒé™:"
    ls -l /etc/postgresql/*/main/*.conf 2>/dev/null
    
    echo "å‘ç°çš„æƒé™é—®é¢˜:"
    find /var/lib/postgresql -perm /o+rwx -ls 2>/dev/null | head -5
fi

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶æƒé™
echo ""
echo "å¤‡ä»½æ–‡ä»¶æƒé™æ£€æŸ¥:"
find /backup -name "*.sql" -o -name "*.dump" | xargs ls -l 2>/dev/null | head -5
```

**æƒé™ç›‘æ§å‘Šè­¦**ï¼š
```bash
#!/bin/bash
# æƒé™å¼‚å¸¸ç›‘æ§è„šæœ¬

# æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶æƒé™è¿‡äºå®½æ¾
LOOSE_PERMS=$(find /var/lib/mysql /var/lib/postgresql -perm /o+rwx 2>/dev/null | wc -l)

if [ $LOOSE_PERMS -gt 0 ]; then
    echo "è­¦å‘Šï¼šå‘ç° $LOOSE_PERMS ä¸ªæ–‡ä»¶æƒé™è¿‡äºå®½æ¾" | \
    mail -s "æ•°æ®åº“æ–‡ä»¶æƒé™å‘Šè­¦" admin@company.com
fi

# æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦è¢«å…¶ä»–ç”¨æˆ·ä¿®æ”¹
CONFIG_FILES="/etc/mysql/mysql.conf.d/mysqld.cnf /etc/postgresql/*/main/*.conf"
for file in $CONFIG_FILES; do
    if [ -f "$file" ] && [ ! -O "$file" ]; then
        echo "è­¦å‘Šï¼šé…ç½®æ–‡ä»¶ $file æ‰€æœ‰è€…å¼‚å¸¸" | \
        mail -s "é…ç½®æ–‡ä»¶å®‰å…¨å‘Šè­¦" admin@company.com
    fi
done
```

**æœ€ä½³å®è·µæ€»ç»“**ï¼š

| æ–‡ä»¶ç±»å‹ | **æ¨èæƒé™** | **æ‰€æœ‰è€…** | **è¯´æ˜** |
|---------|-------------|-----------|----------|
| ğŸ—„ï¸ **æ•°æ®ç›®å½•** | `700` | `mysql/postgres` | `åªæœ‰æ•°æ®åº“ç”¨æˆ·å¯è®¿é—®` |
| ğŸ“„ **æ•°æ®æ–‡ä»¶** | `600-660` | `mysql/postgres` | `é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–` |
| âš™ï¸ **é…ç½®æ–‡ä»¶** | `600-644` | `rootæˆ–dbç”¨æˆ·` | `ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯` |
| ğŸ“ **æ—¥å¿—æ–‡ä»¶** | `640` | `mysql/postgres:adm` | `å…è®¸ç®¡ç†å‘˜æŸ¥çœ‹æ—¥å¿—` |
| ğŸ’¾ **å¤‡ä»½æ–‡ä»¶** | `600` | `backupç”¨æˆ·` | `ä¸¥æ ¼æ§åˆ¶å¤‡ä»½è®¿é—®` |

---

## 8. ğŸ”‘ å¼±å¯†ç æ£€æŸ¥ä¸å¯†ç ç­–ç•¥


### 8.1 å¼±å¯†ç çš„å±å®³ä¸è¯†åˆ«


**ä»€ä¹ˆæ˜¯å¼±å¯†ç **ï¼šå°±åƒç”¨"123456"å½“ä½œé“¶è¡Œå¡å¯†ç ä¸€æ ·ï¼Œå¼±å¯†ç æ˜¯å®¹æ˜“è¢«çŒœæµ‹æˆ–ç ´è§£çš„å¯†ç ã€‚æ•°æ®åº“å¼±å¯†ç ä¼šè®©æ•´ä¸ªç³»ç»Ÿå˜æˆ"çº¸ç³Šçš„ä¿é™©ç®±"ã€‚

**å¸¸è§å¼±å¯†ç ç±»å‹**ï¼š
- **ç®€å•æ•°å­—**ï¼š123456ã€888888ã€000000
- **ç®€å•å­—æ¯**ï¼špasswordã€adminã€root
- **é”®ç›˜æ’åˆ—**ï¼šqwertyã€asdfgh
- **ä¸ªäººä¿¡æ¯**ï¼šç”Ÿæ—¥ã€å§“åã€ç”µè¯å·ç 
- **é»˜è®¤å¯†ç **ï¼šrootã€adminã€ç©ºå¯†ç 

**å¼±å¯†ç çš„æ”»å‡»æ–¹å¼**ï¼š
```
å¯†ç æ”»å‡»ç±»å‹ï¼š
ğŸ”¸ å­—å…¸æ”»å‡»ï¼šä½¿ç”¨å¸¸è§å¯†ç åˆ—è¡¨é€ä¸€å°è¯•
ğŸ”¸ æš´åŠ›ç ´è§£ï¼šä½¿ç”¨æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦ç»„åˆ
ğŸ”¸ ç¤¾ä¼šå·¥ç¨‹ï¼šé€šè¿‡ä¸ªäººä¿¡æ¯çŒœæµ‹å¯†ç 
ğŸ”¸ å½©è™¹è¡¨ï¼šé¢„è®¡ç®—çš„å¯†ç å“ˆå¸Œå¯¹ç…§è¡¨
ğŸ”¸ æ’åº“æ”»å‡»ï¼šåˆ©ç”¨å…¶ä»–ç½‘ç«™æ³„éœ²çš„å¯†ç 
```

### 8.2 MySQLå¯†ç ç­–ç•¥é…ç½®


**å¯ç”¨å¯†ç éªŒè¯æ’ä»¶**ï¼š
```sql
-- å®‰è£…å¯†ç éªŒè¯æ’ä»¶
INSTALL PLUGIN validate_password SONAME 'validate_password.so';

-- æŸ¥çœ‹æ’ä»¶çŠ¶æ€
SHOW PLUGINS;

-- æŸ¥çœ‹å¯†ç ç­–ç•¥é…ç½®
SHOW VARIABLES LIKE 'validate_password%';
```

**é…ç½®å¯†ç ç­–ç•¥**ï¼š
```sql
-- è®¾ç½®å¯†ç ç­–ç•¥ç­‰çº§
-- 0=LOW, 1=MEDIUM, 2=STRONG
SET GLOBAL validate_password.policy = 2;

-- è®¾ç½®å¯†ç æœ€å°é•¿åº¦
SET GLOBAL validate_password.length = 12;

-- è®¾ç½®æ•°å­—å­—ç¬¦æœ€å°ä¸ªæ•°
SET GLOBAL validate_password.number_count = 2;

-- è®¾ç½®å°å†™å­—æ¯æœ€å°ä¸ªæ•°
SET GLOBAL validate_password.lowercase_count = 2;

-- è®¾ç½®å¤§å†™å­—æ¯æœ€å°ä¸ªæ•°
SET GLOBAL validate_password.uppercase_count = 2;

-- è®¾ç½®ç‰¹æ®Šå­—ç¬¦æœ€å°ä¸ªæ•°
SET GLOBAL validate_password.special_char_count = 2;

-- è®¾ç½®å­—å…¸æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
SET GLOBAL validate_password.dictionary_file = '/usr/share/dict/words';
```

**æ°¸ä¹…é…ç½®æ–‡ä»¶è®¾ç½®**ï¼š
```bash
# ç¼–è¾‘MySQLé…ç½®æ–‡ä»¶
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

# æ·»åŠ å¯†ç ç­–ç•¥é…ç½®
[mysqld]
plugin-load-add=validate_password.so
validate_password.policy=STRONG
validate_password.length=12
validate_password.number_count=2
validate_password.lowercase_count=2
validate_password.uppercase_count=2
validate_password.special_char_count=2
```

**æµ‹è¯•å¯†ç å¼ºåº¦**ï¼š
```sql
-- æµ‹è¯•å¯†ç æ˜¯å¦ç¬¦åˆç­–ç•¥
SELECT VALIDATE_PASSWORD_STRENGTH('123456');        -- è¿”å›0ï¼ˆå¼±ï¼‰
SELECT VALIDATE_PASSWORD_STRENGTH('Password123!');  -- è¿”å›è¾ƒé«˜å€¼ï¼ˆå¼ºï¼‰

-- åˆ›å»ºç”¨æˆ·æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥å¯†ç å¼ºåº¦
CREATE USER 'testuser'@'localhost' IDENTIFIED BY 'WeakPass';  -- ä¼šå¤±è´¥
CREATE USER 'testuser'@'localhost' IDENTIFIED BY 'StrongP@ss123!';  -- æˆåŠŸ
```

### 8.3 PostgreSQLå¯†ç ç­–ç•¥é…ç½®


**é…ç½®å¯†ç è®¤è¯**ï¼š
```bash
# ç¼–è¾‘pg_hba.confé…ç½®å¯†ç è®¤è¯
sudo nano /etc/postgresql/13/main/pg_hba.conf

# é…ç½®å¯†ç è®¤è¯æ–¹å¼
local   all         all                     md5
host    all         all    127.0.0.1/32     md5
host    all         all    ::1/128          md5
```

**è®¾ç½®å¯†ç å¤æ‚æ€§è¦æ±‚**ï¼š
```sql
-- è®¾ç½®å¯†ç åŠ å¯†æ–¹å¼
ALTER SYSTEM SET password_encryption = 'scram-sha-256';
SELECT pg_reload_conf();

-- åˆ›å»ºæ£€æŸ¥å¯†ç å¼ºåº¦çš„å‡½æ•°
CREATE OR REPLACE FUNCTION check_password_strength(password TEXT)
RETURNS BOOLEAN AS $$
BEGIN
    -- æ£€æŸ¥å¯†ç é•¿åº¦
    IF LENGTH(password) < 12 THEN
        RAISE EXCEPTION 'å¯†ç é•¿åº¦è‡³å°‘12ä½';
    END IF;
    
    -- æ£€æŸ¥æ˜¯å¦åŒ…å«å¤§å†™å­—æ¯
    IF password !~ '[A-Z]' THEN
        RAISE EXCEPTION 'å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯';
    END IF;
    
    -- æ£€æŸ¥æ˜¯å¦åŒ…å«å°å†™å­—æ¯
    IF password !~ '[a-z]' THEN
        RAISE EXCEPTION 'å¯†ç å¿…é¡»åŒ…å«å°å†™å­—æ¯';
    END IF;
    
    -- æ£€æŸ¥æ˜¯å¦åŒ…å«æ•°å­—
    IF password !~ '[0-9]' THEN
        RAISE EXCEPTION 'å¯†ç å¿…é¡»åŒ…å«æ•°å­—';
    END IF;
    
    -- æ£€æŸ¥æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦
    IF password !~ '[!@#$%^&*(),.?":{}|<>]' THEN
        RAISE EXCEPTION 'å¯†ç å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦';
    END IF;
    
    RETURN TRUE;
END;
$$ LANGUAGE plpgsql;
```

**å®‰è£…passwordcheckæ‰©å±•**ï¼š
```bash
# å®‰è£…passwordcheckæ‰©å±•
sudo apt-get install postgresql-contrib

# é…ç½®postgresql.conf
sudo nano /etc/postgresql/13/main/postgresql.conf

# æ·»åŠ æ‰©å±•åŠ è½½
shared_preload_libraries = 'passwordcheck'

# é‡å¯PostgreSQL
sudo systemctl restart postgresql
```

### 8.4 å¼±å¯†ç æ£€æŸ¥å·¥å…·


**MySQLå¼±å¯†ç æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# MySQLå¼±å¯†ç æ£€æŸ¥è„šæœ¬

WEAK_PASSWORDS="123456 password admin root mysql test guest 123123 qwerty"
MYSQL_USER="root"
MYSQL_HOST="localhost"

echo "=== MySQLå¼±å¯†ç æ£€æŸ¥ ==="

# è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
mysql -u$MYSQL_USER -p -h$MYSQL_HOST -e "SELECT User, Host FROM mysql.user;" | \
while read user host; do
    if [[ "$user" != "User" ]]; then
        echo "æ£€æŸ¥ç”¨æˆ·: $user@$host"
        
        # å°è¯•å¼±å¯†ç ç™»å½•
        for weak_pass in $WEAK_PASSWORDS; do
            mysql -u"$user" -p"$weak_pass" -h"$host" -e "SELECT 1;" 2>/dev/null
            if [ $? -eq 0 ]; then
                echo "âš ï¸  å‘ç°å¼±å¯†ç : $user@$host ä½¿ç”¨å¯†ç  '$weak_pass'"
            fi
        done
    fi
done
```

**å¯†ç å¼ºåº¦æ£€æŸ¥å·¥å…·**ï¼š
```python
#!/usr/bin/env python3
# å¯†ç å¼ºåº¦æ£€æŸ¥å·¥å…·

import re
import sys

def check_password_strength(password):
    """æ£€æŸ¥å¯†ç å¼ºåº¦"""
    score = 0
    feedback = []
    
    # é•¿åº¦æ£€æŸ¥
    if len(password) >= 12:
        score += 2
    elif len(password) >= 8:
        score += 1
    else:
        feedback.append("å¯†ç é•¿åº¦è‡³å°‘8ä½ï¼Œå»ºè®®12ä½ä»¥ä¸Š")
    
    # å¤æ‚æ€§æ£€æŸ¥
    if re.search(r'[a-z]', password):
        score += 1
    else:
        feedback.append("éœ€è¦åŒ…å«å°å†™å­—æ¯")
    
    if re.search(r'[A-Z]', password):
        score += 1
    else:
        feedback.append("éœ€è¦åŒ…å«å¤§å†™å­—æ¯")
    
    if re.search(r'[0-9]', password):
        score += 1
    else:
        feedback.append("éœ€è¦åŒ…å«æ•°å­—")
    
    if re.search(r'[!@#$%^&*(),.?":{}|<>]', password):
        score += 1
    else:
        feedback.append("éœ€è¦åŒ…å«ç‰¹æ®Šå­—ç¬¦")
    
    # å¸¸è§å¼±å¯†ç æ£€æŸ¥
    weak_patterns = [
        r'123456', r'password', r'admin', r'root',
        r'qwerty', r'abc123', r'123123'
    ]
    
    for pattern in weak_patterns:
        if re.search(pattern, password.lower()):
            score -= 2
            feedback.append(f"åŒ…å«å¸¸è§å¼±å¯†ç æ¨¡å¼: {pattern}")
    
    # è¯„çº§
    if score >= 6:
        strength = "å¼º"
    elif score >= 4:
        strength = "ä¸­ç­‰"
    else:
        strength = "å¼±"
    
    return strength, score, feedback

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("ä½¿ç”¨æ–¹æ³•: python3 password_check.py <å¯†ç >")
        sys.exit(1)
    
    password = sys.argv[1]
    strength, score, feedback = check_password_strength(password)
    
    print(f"å¯†ç å¼ºåº¦: {strength} (è¯„åˆ†: {score}/6)")
    if feedback:
        print("æ”¹è¿›å»ºè®®:")
        for item in feedback:
            print(f"  - {item}")
```

### 8.5 å¯†ç ç®¡ç†æœ€ä½³å®è·µ


**å¯†ç ç­–ç•¥åˆ¶å®š**ï¼š
```
å¯†ç å¤æ‚æ€§è¦æ±‚ï¼š
ğŸ”¸ é•¿åº¦ï¼šè‡³å°‘12ä½å­—ç¬¦
ğŸ”¸ ç»„æˆï¼šå¤§å†™+å°å†™+æ•°å­—+ç‰¹æ®Šå­—ç¬¦
ğŸ”¸ ç¦æ­¢ï¼šå­—å…¸è¯æ±‡ã€ä¸ªäººä¿¡æ¯ã€é”®ç›˜æ’åˆ—
ğŸ”¸ æ›´æ¢ï¼šå®šæœŸæ›´æ¢ï¼ˆ3-6ä¸ªæœˆï¼‰
ğŸ”¸ å†å²ï¼šä¸èƒ½é‡å¤ä½¿ç”¨æœ€è¿‘5ä¸ªå¯†ç 
```

**è´¦æˆ·ç®¡ç†ç­–ç•¥**ï¼š

| è´¦æˆ·ç±»å‹ | **å¯†ç è¦æ±‚** | **æƒé™çº§åˆ«** | **ä½¿ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| ğŸ”´ **è¶…çº§ç®¡ç†å‘˜** | `æœ€é«˜å¼ºåº¦ï¼ŒåŒå› å­è®¤è¯` | `å…¨éƒ¨æƒé™` | `ç´§æ€¥ç»´æŠ¤` |
| ğŸŸ¡ **åº”ç”¨è´¦æˆ·** | `å¼ºå¯†ç ï¼Œå®šæœŸè½®æ¢` | `ä¸šåŠ¡æ•°æ®æƒé™` | `åº”ç”¨è¿æ¥` |
| ğŸŸ¢ **åªè¯»è´¦æˆ·** | `ä¸­ç­‰å¼ºåº¦` | `æŸ¥è¯¢æƒé™` | `æŠ¥è¡¨æŸ¥è¯¢` |
| âšª **å¤‡ä»½è´¦æˆ·** | `å¼ºå¯†ç ï¼Œé™æ—¶ä½¿ç”¨` | `å¤‡ä»½æ¢å¤æƒé™` | `æ•°æ®å¤‡ä»½` |

**è‡ªåŠ¨åŒ–å¯†ç ç®¡ç†**ï¼š
```bash
#!/bin/bash
# è‡ªåŠ¨åŒ–å¯†ç è½®æ¢è„šæœ¬

USERS=("app_user" "backup_user" "report_user")
PASSWORD_LENGTH=16

for user in "${USERS[@]}"; do
    # ç”Ÿæˆå¼ºå¯†ç 
    NEW_PASSWORD=$(openssl rand -base64 $PASSWORD_LENGTH | tr -d "=+/" | cut -c1-$PASSWORD_LENGTH)
    
    # éªŒè¯å¯†ç å¼ºåº¦
    if python3 password_check.py "$NEW_PASSWORD" | grep -q "å¼º"; then
        # æ›´æ–°æ•°æ®åº“å¯†ç 
        mysql -u root -p << EOF
ALTER USER '$user'@'%' IDENTIFIED BY '$NEW_PASSWORD';
FLUSH PRIVILEGES;
EOF
        
        # è®°å½•å¯†ç å˜æ›´
        echo "$(date): ç”¨æˆ· $user å¯†ç å·²æ›´æ–°" >> /var/log/password_rotation.log
        
        # é€šçŸ¥ç›¸å…³äººå‘˜ï¼ˆåŠ å¯†å­˜å‚¨æ–°å¯†ç ï¼‰
        echo "$NEW_PASSWORD" | gpg --encrypt --armor -r admin@company.com > /tmp/${user}_password.gpg
    else
        echo "ç”Ÿæˆçš„å¯†ç ä¸ç¬¦åˆå¼ºåº¦è¦æ±‚ï¼Œè·³è¿‡ç”¨æˆ· $user"
    fi
done
```

---

## 9. ğŸ›¡ï¸ é˜²SQLæ³¨å…¥åŸºç¡€é…ç½®


### 9.1 SQLæ³¨å…¥æ”»å‡»åŸç†


**ä»€ä¹ˆæ˜¯SQLæ³¨å…¥**ï¼šå°±åƒæœ‰äººåœ¨ä½ çš„è®¢å•ä¸Šå·å·åŠ äº†é¢å¤–çš„è¦æ±‚ã€‚SQLæ³¨å…¥æ˜¯æ”»å‡»è€…é€šè¿‡åœ¨è¾“å…¥ä¸­æ’å…¥æ¶æ„SQLä»£ç ï¼Œè®©æ•°æ®åº“æ‰§è¡Œéé¢„æœŸçš„æ“ä½œã€‚

**SQLæ³¨å…¥çš„å·¥ä½œåŸç†**ï¼š
```
æ­£å¸¸æŸ¥è¯¢ï¼š
SELECT * FROM users WHERE username='admin' AND password='123456';

SQLæ³¨å…¥æ”»å‡»ï¼š
ç”¨æˆ·è¾“å…¥: admin'; DROP TABLE users; --
å®é™…æ‰§è¡Œ: SELECT * FROM users WHERE username='admin'; DROP TABLE users; --' AND password='123456';

ç»“æœï¼šåŸæœ¬çš„æŸ¥è¯¢å˜æˆäº†ä¸¤ä¸ªè¯­å¥ï¼Œç¬¬äºŒä¸ªè¯­å¥åˆ é™¤äº†æ•´ä¸ªç”¨æˆ·è¡¨ï¼
```

**å¸¸è§SQLæ³¨å…¥ç±»å‹**ï¼š
- **è”åˆæ³¨å…¥**ï¼šä½¿ç”¨UNIONè·å–å…¶ä»–è¡¨æ•°æ®
- **å¸ƒå°”æ³¨å…¥**ï¼šé€šè¿‡çœŸå‡åˆ¤æ–­è·å–ä¿¡æ¯
- **æ—¶é—´æ³¨å…¥**ï¼šé€šè¿‡å»¶è¿Ÿå‡½æ•°åˆ¤æ–­æ‰§è¡Œç»“æœ
- **æŠ¥é”™æ³¨å…¥**ï¼šåˆ©ç”¨é”™è¯¯ä¿¡æ¯è·å–æ•°æ®
- **å †å æ³¨å…¥**ï¼šæ‰§è¡Œå¤šä¸ªSQLè¯­å¥

### 9.2 MySQLé˜²SQLæ³¨å…¥é…ç½®


**å¯ç”¨SQLæ¨¡å¼é™åˆ¶**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰SQLæ¨¡å¼
SELECT $$sql_mode;

-- è®¾ç½®ä¸¥æ ¼SQLæ¨¡å¼
SET GLOBAL sql_mode = 'STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';

-- æ°¸ä¹…é…ç½®ï¼ˆåœ¨my.cnfä¸­ï¼‰
[mysqld]
sql_mode = 'STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'
```

**é…ç½®æŸ¥è¯¢é™åˆ¶**ï¼š
```sql
-- é™åˆ¶æŸ¥è¯¢å¤æ‚åº¦
SET GLOBAL max_join_size = 1000000;
SET GLOBAL max_seeks_for_key = 1000;

-- é™åˆ¶æŸ¥è¯¢æ—¶é—´
SET GLOBAL max_execution_time = 30000;  -- 30ç§’è¶…æ—¶

-- é™åˆ¶å†…å­˜ä½¿ç”¨
SET GLOBAL max_heap_table_size = 64M;
SET GLOBAL tmp_table_size = 64M;
```

**ç¦ç”¨å±é™©å‡½æ•°**ï¼š
```bash
# ç¼–è¾‘MySQLé…ç½®æ–‡ä»¶
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

# ç¦ç”¨æ–‡ä»¶æ“ä½œå‡½æ•°
[mysqld]
local-infile=0
secure-file-priv="/var/lib/mysql-files/"

# ç¦ç”¨ç¬¦å·é“¾æ¥
symbolic-links=0
```

**ç”¨æˆ·æƒé™æœ€å°åŒ–**ï¼š
```sql
-- åˆ›å»ºä¸“ç”¨åº”ç”¨ç”¨æˆ·ï¼Œåªç»™å¿…è¦æƒé™
CREATE USER 'webapp'@'%' IDENTIFIED BY 'StrongP@ss123!';

-- åªæˆäºˆå¿…è¦çš„æƒé™
GRANT SELECT, INSERT, UPDATE ON myapp.users TO 'webapp'@'%';
GRANT SELECT, INSERT, UPDATE ON myapp.orders TO 'webapp'@'%';

-- ä¸è¦ç»™å±é™©æƒé™
-- REVOKE FILE ON *.* FROM 'webapp'@'%';
-- REVOKE PROCESS ON *.* FROM 'webapp'@'%';
-- REVOKE SUPER ON *.* FROM 'webapp'@'%';

FLUSH PRIVILEGES;
```

### 9.3 PostgreSQLé˜²SQLæ³¨å…¥é…ç½®


**é…ç½®å®‰å…¨å‚æ•°**ï¼š
```bash
# ç¼–è¾‘postgresql.conf
sudo nano /etc/postgresql/13/main/postgresql.conf

# é™åˆ¶è¯­å¥å¤æ‚åº¦
max_locks_per_transaction = 64
max_pred_locks_per_transaction = 64

# é™åˆ¶æ‰§è¡Œæ—¶é—´
statement_timeout = 30000          # 30ç§’è¶…æ—¶
lock_timeout = 10000              # 10ç§’é”è¶…æ—¶
idle_in_transaction_session_timeout = 60000  # 60ç§’ç©ºé—²è¶…æ—¶

# è®°å½•é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
log_min_duration_statement = 5000  # è®°å½•è¶…è¿‡5ç§’çš„æŸ¥è¯¢
```

**é…ç½®è§’è‰²å’Œæƒé™**ï¼š
```sql
-- åˆ›å»ºåº”ç”¨ä¸“ç”¨è§’è‰²
CREATE ROLE webapp_role LOGIN PASSWORD 'StrongP@ss123!';

-- åˆ›å»ºä¸“ç”¨schema
CREATE SCHEMA webapp_schema AUTHORIZATION webapp_role;

-- åªæˆäºˆå¿…è¦æƒé™
GRANT CONNECT ON DATABASE myapp TO webapp_role;
GRANT USAGE ON SCHEMA webapp_schema TO webapp_role;
GRANT SELECT, INSERT, UPDATE ON webapp_schema.users TO webapp_role;
GRANT SELECT, INSERT, UPDATE ON webapp_schema.orders TO webapp_role;

-- ç¦ç”¨å±é™©æƒé™
REVOKE CREATE ON SCHEMA public FROM webapp_role;
REVOKE ALL ON pg_catalog.pg_proc FROM webapp_role;
```

**ç¦ç”¨å±é™©å‡½æ•°**ï¼š
```sql
-- åˆ›å»ºå—é™åˆ¶çš„å‡½æ•°ç­–ç•¥
CREATE OR REPLACE FUNCTION prevent_dangerous_functions()
RETURNS event_trigger AS $
BEGIN
    IF tg_tag IN ('CREATE FUNCTION', 'ALTER FUNCTION') THEN
        IF position('pg_read_file' in lower(current_query())) > 0 OR
           position('pg_ls_dir' in lower(current_query())) > 0 OR
           position('pg_stat_file' in lower(current_query())) > 0 THEN
            RAISE EXCEPTION 'ç¦æ­¢åˆ›å»ºä½¿ç”¨å±é™©å‡½æ•°çš„è‡ªå®šä¹‰å‡½æ•°';
        END IF;
    END IF;
END;
$ LANGUAGE plpgsql;

-- åˆ›å»ºäº‹ä»¶è§¦å‘å™¨
CREATE EVENT TRIGGER prevent_dangerous_functions_trigger
ON ddl_command_start
EXECUTE FUNCTION prevent_dangerous_functions();
```

### 9.4 åº”ç”¨å±‚é˜²æŠ¤æªæ–½


**å‚æ•°åŒ–æŸ¥è¯¢ç¤ºä¾‹**ï¼š
```python
# é”™è¯¯çš„åšæ³• - å®¹æ˜“SQLæ³¨å…¥
def get_user_bad(username, password):
    query = f"SELECT * FROM users WHERE username='{username}' AND password='{password}'"
    cursor.execute(query)
    return cursor.fetchone()

# æ­£ç¡®çš„åšæ³• - ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
def get_user_safe(username, password):
    query = "SELECT * FROM users WHERE username=%s AND password=%s"
    cursor.execute(query, (username, password))
    return cursor.fetchone()

# ä½¿ç”¨ORMï¼ˆæ›´å®‰å…¨ï¼‰
def get_user_orm(username, password):
    return User.objects.filter(username=username, password=password).first()
```

**è¾“å…¥éªŒè¯ç¤ºä¾‹**ï¼š
```python
import re

def validate_input(user_input, input_type):
    """è¾“å…¥éªŒè¯å‡½æ•°"""
    
    # é€šç”¨å±é™©å­—ç¬¦æ£€æŸ¥
    dangerous_chars = ["'", '"', ';', '--', '/*', '*/', 'xp_', 'sp_']
    for char in dangerous_chars:
        if char in user_input.lower():
            raise ValueError(f"è¾“å…¥åŒ…å«å±é™©å­—ç¬¦: {char}")
    
    # æ ¹æ®ç±»å‹éªŒè¯
    if input_type == 'username':
        if not re.match(r'^[a-zA-Z0-9_]{3,20}, user_input):
            raise ValueError("ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®")
    
    elif input_type == 'email':
        if not re.match(r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}, user_input):
            raise ValueError("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    
    elif input_type == 'id':
        if not user_input.isdigit():
            raise ValueError("IDå¿…é¡»æ˜¯æ•°å­—")
    
    return True

# ä½¿ç”¨ç¤ºä¾‹
try:
    username = request.form['username']
    validate_input(username, 'username')
    # ç»§ç»­å¤„ç†...
except ValueError as e:
    return {"error": str(e)}, 400
```

### 9.5 SQLæ³¨å…¥æ£€æµ‹ä¸é˜²æŠ¤å·¥å…·


**è‡ªåŠ¨åŒ–SQLæ³¨å…¥æ£€æµ‹è„šæœ¬**ï¼š
```bash
#!/bin/bash
# SQLæ³¨å…¥æ”»å‡»æ£€æµ‹è„šæœ¬

LOG_FILE="/var/log/mysql/general.log"
ALERT_FILE="/var/log/sql_injection_alerts.log"

echo "=== SQLæ³¨å…¥æ”»å‡»æ£€æµ‹ $(date) ===" >> $ALERT_FILE

# æ£€æµ‹å¸¸è§SQLæ³¨å…¥æ¨¡å¼
INJECTION_PATTERNS=(
    "union.*select"
    "'; drop table"
    "'; delete from"
    "'; update.*set"
    "or 1=1"
    "or '1'='1'"
    "having 1=1"
    "benchmark\("
    "sleep\("
    "waitfor delay"
)

for pattern in "${INJECTION_PATTERNS[@]}"; do
    matches=$(grep -i "$pattern" $LOG_FILE | tail -20)
    if [ ! -z "$matches" ]; then
        echo "æ£€æµ‹åˆ°å¯èƒ½çš„SQLæ³¨å…¥æ”»å‡»æ¨¡å¼: $pattern" >> $ALERT_FILE
        echo "$matches" >> $ALERT_FILE
        echo "---" >> $ALERT_FILE
    fi
done

# æ£€æµ‹å¼‚å¸¸æŸ¥è¯¢é¢‘ç‡
HIGH_FREQ_IPS=$(awk '{print $5}' $LOG_FILE | sort | uniq -c | sort -nr | head -5)
echo "é«˜é¢‘è®¿é—®IP:" >> $ALERT_FILE
echo "$HIGH_FREQ_IPS" >> $ALERT_FILE
```

**Webåº”ç”¨é˜²ç«å¢™è§„åˆ™**ï¼š
```apache
# Apache mod_securityè§„åˆ™ç¤ºä¾‹
<IfModule mod_security2.c>
    # å¯ç”¨ModSecurity
    SecRuleEngine On
    
    # SQLæ³¨å…¥é˜²æŠ¤è§„åˆ™
    SecRule ARGS "@detectSQLi" \
        "id:1001,phase:2,block,msg:'SQL Injection Attack',logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"
    
    # å¸¸è§æ³¨å…¥å…³é”®è¯
    SecRule ARGS "@rx (?i:(union.*select|insert.*into|delete.*from|drop.*table|create.*table))" \
        "id:1002,phase:2,block,msg:'SQL Injection Keywords'"
    
    # æ³¨é‡Šç¬¦å·
    SecRule ARGS "@rx (?i:(--|#|\*|/\*))" \
        "id:1003,phase:2,block,msg:'SQL Comment Characters'"
</IfModule>
```

**æ•°æ®åº“ç›‘æ§å‘Šè­¦**ï¼š
```python
#!/usr/bin/env python3
# æ•°æ®åº“å¼‚å¸¸æŸ¥è¯¢ç›‘æ§

import mysql.connector
import time
import smtplib
from email.mime.text import MimeText

def monitor_suspicious_queries():
    """ç›‘æ§å¯ç–‘æŸ¥è¯¢"""
    
    # è¿æ¥æ•°æ®åº“
    conn = mysql.connector.connect(
        host='localhost',
        user='monitor_user',
        password='monitor_pass',
        database='information_schema'
    )
    
    cursor = conn.cursor()
    
    # æŸ¥è¯¢æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹
    cursor.execute("""
        SELECT ID, USER, HOST, DB, COMMAND, TIME, STATE, INFO
        FROM PROCESSLIST 
        WHERE COMMAND = 'Query' AND TIME > 10
    """)
    
    long_queries = cursor.fetchall()
    
    for query in long_queries:
        query_text = query[7] if query[7] else ""
        
        # æ£€æŸ¥æ˜¯å¦åŒ…å«å±é™©æ¨¡å¼
        dangerous_patterns = [
            'union select', 'drop table', 'delete from',
            'or 1=1', 'or \'1\'=\'1\'', 'benchmark(',
            'sleep(', 'load_file(', 'into outfile'
        ]
        
        for pattern in dangerous_patterns:
            if pattern.lower() in query_text.lower():
                alert_message = f"""
                æ£€æµ‹åˆ°å¯ç–‘SQLæŸ¥è¯¢:
                ç”¨æˆ·: {query[1]}
                ä¸»æœº: {query[2]}
                æ•°æ®åº“: {query[3]}
                æ‰§è¡Œæ—¶é—´: {query[5]}ç§’
                æŸ¥è¯¢: {query_text[:200]}...
                """
                
                send_alert(alert_message)
                
                # å¯é€‰ï¼šç»ˆæ­¢å¯ç–‘æŸ¥è¯¢
                # cursor.execute(f"KILL {query[0]}")
                break
    
    cursor.close()
    conn.close()

def send_alert(message):
    """å‘é€å‘Šè­¦é‚®ä»¶"""
    msg = MimeText(message, 'plain', 'utf-8')
    msg['Subject'] = 'SQLæ³¨å…¥æ”»å‡»å‘Šè­¦'
    msg['From'] = 'monitor@company.com'
    msg['To'] = 'admin@company.com'
    
    try:
        server = smtplib.SMTP('localhost', 587)
        server.send_message(msg)
        server.quit()
    except Exception as e:
        print(f"å‘é€å‘Šè­¦å¤±è´¥: {e}")

if __name__ == "__main__":
    while True:
        monitor_suspicious_queries()
        time.sleep(60)  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
```

---

## 10. ğŸ’¾ å¤‡ä»½æ–‡ä»¶å®‰å…¨å­˜å‚¨


### 10.1 å¤‡ä»½æ–‡ä»¶å®‰å…¨çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆå¤‡ä»½æ–‡ä»¶éœ€è¦ç‰¹åˆ«ä¿æŠ¤**ï¼šå¤‡ä»½æ–‡ä»¶å°±åƒä¿é™©ç®±çš„å¤‡ç”¨é’¥åŒ™ï¼Œå¦‚æœè¢«åäººæ‹¿åˆ°ï¼Œä»–ä»¬å°±èƒ½è·å¾—å’Œæ­£å¼æ•°æ®åº“ä¸€æ ·çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œä¸”å¤‡ä»½æ–‡ä»¶é€šå¸¸æ²¡æœ‰è®¿é—®æ§åˆ¶ï¼Œé£é™©æ›´å¤§ã€‚

**å¤‡ä»½æ–‡ä»¶é¢ä¸´çš„å¨èƒ**ï¼š
- **æœªæˆæƒè®¿é—®**ï¼šå¤‡ä»½æ–‡ä»¶è¢«æ¶æ„ä¸‹è½½
- **å†…éƒ¨æ³„éœ²**ï¼šå†…éƒ¨äººå‘˜æ¶æ„æˆ–è¯¯æ“ä½œ
- **ä¼ è¾“æ³„éœ²**ï¼šç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­è¢«æˆªè·
- **å­˜å‚¨æ³„éœ²**ï¼šå­˜å‚¨ä»‹è´¨ä¸¢å¤±æˆ–è¢«ç›—
- **äº‘å­˜å‚¨é£é™©**ï¼šäº‘æœåŠ¡å•†çš„å®‰å…¨é—®é¢˜

### 10.2 å¤‡ä»½æ–‡ä»¶åŠ å¯†å­˜å‚¨


**MySQLå¤‡ä»½åŠ å¯†ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# MySQLåŠ å¯†å¤‡ä»½è„šæœ¬

DB_USER="backup_user"
DB_PASS="backup_password"
DB_NAME="myapp"
BACKUP_DIR="/secure/backups"
DATE=$(date +%Y%m%d_%H%M%S)
ENCRYPTION_KEY="backup_encryption_key_2023"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# åˆ›å»ºåŠ å¯†å¤‡ä»½
mysqldump -u$DB_USER -p$DB_PASS \
    --single-transaction \
    --routines \
    --triggers \
    $DB_NAME | \
gzip | \
openssl enc -aes-256-cbc -salt -k "$ENCRYPTION_KEY" \
    -out "$BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz.enc"

# éªŒè¯å¤‡ä»½æ–‡ä»¶
if [ -f "$BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz.enc" ]; then
    echo "$(date): å¤‡ä»½æˆåŠŸ - ${DB_NAME}_${DATE}.sql.gz.enc" >> $BACKUP_DIR/backup.log
    
    # è®¾ç½®ä¸¥æ ¼çš„æ–‡ä»¶æƒé™
    chmod 600 "$BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz.enc"
    chown backup:backup "$BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz.enc"
else
    echo "$(date): å¤‡ä»½å¤±è´¥ - $DB_NAME" >> $BACKUP_DIR/backup.log
    exit 1
fi

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™30å¤©ï¼‰
find $BACKUP_DIR -name "*.sql.gz.enc" -mtime +30 -delete
```

**PostgreSQLå¤‡ä»½åŠ å¯†ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# PostgreSQLåŠ å¯†å¤‡ä»½è„šæœ¬

export PGPASSWORD="backup_password"
DB_USER="backup_user"
DB_NAME="myapp"
DB_HOST="localhost"
BACKUP_DIR="/secure/backups"
DATE=$(date +%Y%m%d_%H%M%S)
GPG_RECIPIENT="backup@company.com"

mkdir -p $BACKUP_DIR

# åˆ›å»ºå‹ç¼©åŠ å¯†å¤‡ä»½
pg_dump -h $DB_HOST -U $DB_USER -d $DB_NAME \
    --verbose --clean --no-owner --no-privileges | \
gzip | \
gpg --trust-model always --encrypt -r $GPG_RECIPIENT \
    --output "$BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz.gpg"

# éªŒè¯å’Œè®¾ç½®æƒé™
if [ -f "$BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz.gpg" ]; then
    echo "$(date): PostgreSQLå¤‡ä»½æˆåŠŸ - ${DB_NAME}_${DATE}.sql.gz.gpg" >> $BACKUP_DIR/backup.log
    chmod 600 "$BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz.gpg"
    chown postgres:postgres "$BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz.gpg"
else
    echo "$(date): PostgreSQLå¤‡ä»½å¤±è´¥ - $DB_NAME" >> $BACKUP_DIR/backup.log
    exit 1
fi
```

### 10.3 å¤‡ä»½æ–‡ä»¶æ¢å¤éªŒè¯


**å¤‡ä»½è§£å¯†æ¢å¤è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å¤‡ä»½è§£å¯†æ¢å¤è„šæœ¬

BACKUP_FILE="$1"
ENCRYPTION_KEY="backup_encryption_key_2023"
TEMP_DIR="/tmp/restore_$"

if [ -z "$BACKUP_FILE" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <å¤‡ä»½æ–‡ä»¶è·¯å¾„>"
    exit 1
fi

# åˆ›å»ºä¸´æ—¶ç›®å½•
mkdir -p $TEMP_DIR

echo "å¼€å§‹è§£å¯†æ¢å¤å¤‡ä»½æ–‡ä»¶: $BACKUP_FILE"

# è§£å¯†å¤‡ä»½æ–‡ä»¶
if [[ "$BACKUP_FILE" == *.enc ]]; then
    echo "è§£å¯†ä¸­..."
    openssl enc -aes-256-cbc -d -salt -k "$ENCRYPTION_KEY" \
        -in "$BACKUP_FILE" | gunzip > "$TEMP_DIR/restore.sql"
    
elif [[ "$BACKUP_FILE" == *.gpg ]]; then
    echo "GPGè§£å¯†ä¸­..."
    gpg --decrypt "$BACKUP_FILE" | gunzip > "$TEMP_DIR/restore.sql"
    
else
    echo "ä¸æ”¯æŒçš„å¤‡ä»½æ–‡ä»¶æ ¼å¼"
    exit 1
fi

# éªŒè¯SQLæ–‡ä»¶
if [ -s "$TEMP_DIR/restore.sql" ]; then
    echo "è§£å¯†æˆåŠŸï¼ŒSQLæ–‡ä»¶å¤§å°: $(du -h $TEMP_DIR/restore.sql | cut -f1)"
    
    # å¯é€‰ï¼šæ¢å¤åˆ°æµ‹è¯•æ•°æ®åº“è¿›è¡ŒéªŒè¯
    read -p "æ˜¯å¦æ¢å¤åˆ°æµ‹è¯•æ•°æ®åº“è¿›è¡ŒéªŒè¯ï¼Ÿ(y/n): " confirm
    if [ "$confirm" = "y" ]; then
        mysql -u root -p test_db < "$TEMP_DIR/restore.sql"
        echo "å·²æ¢å¤åˆ°test_dbæ•°æ®åº“ï¼Œè¯·éªŒè¯æ•°æ®å®Œæ•´æ€§"
    fi
else
    echo "è§£å¯†å¤±è´¥æˆ–æ–‡ä»¶ä¸ºç©º"
    exit 1
fi

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf $TEMP_DIR
```

### 10.4 å¼‚åœ°å¤‡ä»½å­˜å‚¨


**è¿œç¨‹åŒæ­¥å¤‡ä»½è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å®‰å…¨è¿œç¨‹å¤‡ä»½åŒæ­¥è„šæœ¬

LOCAL_BACKUP_DIR="/secure/backups"
REMOTE_HOST="backup-server.company.com"
REMOTE_USER="backup_sync"
REMOTE_DIR="/backup/database"
SSH_KEY="/home/backup/.ssh/backup_key"

# ä½¿ç”¨rsyncé€šè¿‡SSHå®‰å…¨ä¼ è¾“
rsync -avz --delete \
    -e "ssh -i $SSH_KEY -o StrictHostKeyChecking=yes" \
    $LOCAL_BACKUP_DIR/ \
    $REMOTE_USER@$REMOTE_HOST:$REMOTE_DIR/

if [ $? -eq 0 ]; then
    echo "$(date): è¿œç¨‹å¤‡ä»½åŒæ­¥æˆåŠŸ" >> /var/log/remote_backup.log
else
    echo "$(date): è¿œç¨‹å¤‡ä»½åŒæ­¥å¤±è´¥" >> /var/log/remote_backup.log
    
    # å‘é€å‘Šè­¦
    echo "è¿œç¨‹å¤‡ä»½åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œæƒé™" | \
    mail -s "å¤‡ä»½åŒæ­¥å¤±è´¥å‘Šè­¦" admin@company.com
fi
```

**äº‘å­˜å‚¨å¤‡ä»½è„šæœ¬**ï¼š
```bash
#!/bin/bash
# AWS S3åŠ å¯†å¤‡ä»½ä¸Šä¼ è„šæœ¬

BACKUP_DIR="/secure/backups"
S3_BUCKET="company-database-backups"
AWS_PROFILE="backup-user"

# ä¸Šä¼ åŠ å¯†å¤‡ä»½åˆ°S3ï¼Œå¯ç”¨æœåŠ¡ç«¯åŠ å¯†
for file in $BACKUP_DIR/*.enc; do
    if [ -f "$file" ]; then
        filename=$(basename "$file")
        
        aws s3 cp "$file" "s3://$S3_BUCKET/mysql/" \
            --profile $AWS_PROFILE \
            --server-side-encryption AES256 \
            --storage-class STANDARD_IA
        
        if [ $? -eq 0 ]; then
            echo "$(date): ä¸Šä¼ æˆåŠŸ - $filename" >> /var/log/s3_backup.log
            
            # éªŒè¯ä¸Šä¼ çš„æ–‡ä»¶
            aws s3 ls "s3://$S3_BUCKET/mysql/$filename" --profile $AWS_PROFILE
        else
            echo "$(date): ä¸Šä¼ å¤±è´¥ - $filename" >> /var/log/s3_backup.log
        fi
    fi
done

# æ¸…ç†è¿‡æœŸçš„äº‘å¤‡ä»½ï¼ˆä¿ç•™90å¤©ï¼‰
aws s3api list-objects-v2 --bucket $S3_BUCKET --prefix "mysql/" \
    --query 'Contents[?LastModified<`2023-01-01`].Key' \
    --profile $AWS_PROFILE | \
jq -r '.[]' | \
while read key; do
    aws s3 rm "s3://$S3_BUCKET/$key" --profile $AWS_PROFILE
    echo "$(date): åˆ é™¤è¿‡æœŸå¤‡ä»½ - $key" >> /var/log/s3_backup.log
done
```

### 10.5 å¤‡ä»½å®‰å…¨ç®¡ç†ç­–ç•¥


**å¤‡ä»½å­˜å‚¨å®‰å…¨ç­‰çº§**ï¼š

| å®‰å…¨ç­‰çº§ | **å­˜å‚¨æ–¹å¼** | **åŠ å¯†è¦æ±‚** | **è®¿é—®æ§åˆ¶** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|-------------|
| ğŸŸ¢ **åŸºç¡€** | `æœ¬åœ°ç£ç›˜` | `æ–‡ä»¶ç³»ç»ŸåŠ å¯†` | `ç”¨æˆ·æƒé™æ§åˆ¶` | `å¼€å‘ç¯å¢ƒ` |
| ğŸŸ¡ **æ ‡å‡†** | `ç½‘ç»œå­˜å‚¨` | `ä¼ è¾“+å­˜å‚¨åŠ å¯†` | `è§’è‰²æƒé™+å®¡è®¡` | `ç”Ÿäº§ç¯å¢ƒ` |
| ğŸŸ  **é«˜çº§** | `å¼‚åœ°å¤‡ä»½` | `ç«¯åˆ°ç«¯åŠ å¯†` | `åŒå› å­è®¤è¯` | `é‡è¦ä¸šåŠ¡` |
| ğŸ”´ **æœ€é«˜** | `å¤šåœ°å†—ä½™` | `ç¡¬ä»¶åŠ å¯†` | `å¤šé‡è®¤è¯+éš”ç¦»` | `é‡‘èã€åŒ»ç–—` |

**å¤‡ä»½ç®¡ç†æœ€ä½³å®è·µ**ï¼š
```
å¤‡ä»½å®‰å…¨è¦ç‚¹ï¼š
ğŸ” åŠ å¯†å­˜å‚¨ï¼šæ‰€æœ‰å¤‡ä»½æ–‡ä»¶å¿…é¡»åŠ å¯†
ğŸ”‘ å¯†é’¥ç®¡ç†ï¼šåŠ å¯†å¯†é’¥ä¸å¤‡ä»½æ–‡ä»¶åˆ†ç¦»å­˜å‚¨
ğŸ  å¼‚åœ°å¤‡ä»½ï¼šè‡³å°‘ä¸€ä»½å¤‡ä»½å­˜å‚¨åœ¨å¼‚åœ°
ğŸ• å®šæœŸéªŒè¯ï¼šå®šæœŸéªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
ğŸ“‹ è®¿é—®å®¡è®¡ï¼šè®°å½•æ‰€æœ‰å¤‡ä»½æ–‡ä»¶è®¿é—®æ—¥å¿—
â° ç”Ÿå‘½å‘¨æœŸï¼šåˆ¶å®šå¤‡ä»½æ–‡ä»¶ä¿ç•™å’Œæ¸…ç†ç­–ç•¥
ğŸ”„ æ¢å¤æµ‹è¯•ï¼šå®šæœŸè¿›è¡Œæ¢å¤æ¼”ç»ƒ
ğŸ‘¥ æƒé™æœ€å°ï¼šæœ€å°‘æƒé™åŸåˆ™è®¿é—®å¤‡ä»½æ–‡ä»¶
```

**è‡ªåŠ¨åŒ–å¤‡ä»½ç›‘æ§**ï¼š
```bash
#!/bin/bash
# å¤‡ä»½æ–‡ä»¶å®‰å…¨ç›‘æ§è„šæœ¬

BACKUP_DIR="/secure/backups"
ALERT_EMAIL="admin@company.com"

echo "=== å¤‡ä»½å®‰å…¨æ£€æŸ¥ $(date) ==="

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶æƒé™
echo "æ£€æŸ¥æ–‡ä»¶æƒé™..."
find $BACKUP_DIR -type f \( -perm /o+rwx -o -perm /g+w \) -ls > /tmp/backup_perm_issues.txt

if [ -s /tmp/backup_perm_issues.txt ]; then
    echo "å‘ç°æƒé™é—®é¢˜:" 
    cat /tmp/backup_perm_issues.txt
    
    # å‘é€å‘Šè­¦é‚®ä»¶
    mail -s "å¤‡ä»½æ–‡ä»¶æƒé™å¼‚å¸¸å‘Šè­¦" $ALERT_EMAIL < /tmp/backup_perm_issues.txt
fi

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
echo "æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§..."
for file in $BACKUP_DIR/*.enc; do
    if [ -f "$file" ]; then
        # å°è¯•è§£å¯†å¤´éƒ¨éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
        if ! openssl enc -aes-256-cbc -d -salt -k "test_key" -in "$file" -out /dev/null 2>/dev/null; then
            echo "æ–‡ä»¶å¯èƒ½æŸå: $file"
            echo "å¤‡ä»½æ–‡ä»¶æŸå: $file $(date)" | mail -s "å¤‡ä»½æ–‡ä»¶æŸåå‘Šè­¦" $ALERT_EMAIL
        fi
    fi
done

# æ£€æŸ¥å¤‡ä»½é¢‘ç‡
LAST_BACKUP=$(find $BACKUP_DIR -name "*.enc" -mtime -1 | wc -l)
if [ $LAST_BACKUP -eq 0 ]; then
    echo "è­¦å‘Š: 24å°æ—¶å†…æ²¡æœ‰æ–°çš„å¤‡ä»½æ–‡ä»¶"
    echo "24å°æ—¶å†…æ²¡æœ‰æ–°çš„å¤‡ä»½æ–‡ä»¶ç”Ÿæˆï¼Œè¯·æ£€æŸ¥å¤‡ä»½ç³»ç»Ÿ" | \
    mail -s "å¤‡ä»½ç¼ºå¤±å‘Šè­¦" $ALERT_EMAIL
fi

echo "å¤‡ä»½å®‰å…¨æ£€æŸ¥å®Œæˆ"
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„å®‰å…¨åŠ å›ºè¦ç‚¹


**ğŸ”¸ å¤šå±‚é˜²æŠ¤ä½“ç³»**ï¼š
```
å®‰å…¨å±‚æ¬¡æ¶æ„ï¼š
ç½‘ç»œå±‚ â†’ ä¼ è¾“å±‚ â†’ åº”ç”¨å±‚ â†’ æ•°æ®å±‚ â†’ ç›‘æ§å±‚
æ¯ä¸€å±‚éƒ½è¦æœ‰ç›¸åº”çš„å®‰å…¨æªæ–½ï¼Œå½¢æˆçºµæ·±é˜²å¾¡
```

**ğŸ”¸ å…³é”®å®‰å…¨é…ç½®**ï¼š
- **è®¿é—®æ§åˆ¶**ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œé™åˆ¶IPå’Œç«¯å£è®¿é—®
- **åŠ å¯†ä¿æŠ¤**ï¼šSSL/TLSä¼ è¾“åŠ å¯†ï¼Œæ•æ„Ÿæ•°æ®å­˜å‚¨åŠ å¯†  
- **å®¡è®¡ç›‘æ§**ï¼šå®Œæ•´çš„æ—¥å¿—è®°å½•å’Œå®æ—¶ç›‘æ§å‘Šè­¦
- **æƒé™ç®¡ç†**ï¼šä¸¥æ ¼çš„æ–‡ä»¶æƒé™å’Œç”¨æˆ·æƒé™æ§åˆ¶
- **å¤‡ä»½å®‰å…¨**ï¼šåŠ å¯†å¤‡ä»½å’Œå®‰å…¨çš„å¼‚åœ°å­˜å‚¨

### 11.2 å®‰å…¨åŠ å›ºæ‰§è¡Œä¼˜å…ˆçº§


| ä¼˜å…ˆçº§ | **å®‰å…¨æªæ–½** | **å®æ–½éš¾åº¦** | **å®‰å…¨æ”¶ç›Š** | **ç´§æ€¥ç¨‹åº¦** |
|-------|-------------|-------------|-------------|-------------|
| ğŸ”´ **æœ€é«˜** | `ç½‘ç»œè®¿é—®æ§åˆ¶` | `ä½` | `é«˜` | `ç«‹å³æ‰§è¡Œ` |
| ğŸ”´ **æœ€é«˜** | `å¼±å¯†ç æ£€æŸ¥` | `ä½` | `é«˜` | `ç«‹å³æ‰§è¡Œ` |
| ğŸŸ¡ **é«˜** | `SSL/TLSåŠ å¯†` | `ä¸­` | `é«˜` | `ä¸€å‘¨å†…` |
| ğŸŸ¡ **é«˜** | `å®¡è®¡æ—¥å¿—é…ç½®` | `ä¸­` | `ä¸­` | `ä¸€å‘¨å†…` |
| ğŸŸ  **ä¸­** | `æ•æ„Ÿæ•°æ®åŠ å¯†` | `é«˜` | `é«˜` | `ä¸€ä¸ªæœˆå†…` |
| ğŸŸ¢ **ä½** | `æ–‡ä»¶æƒé™åŠ å›º` | `ä½` | `ä¸­` | `é€æ­¥å®Œå–„` |

### 11.3 å®‰å…¨åŠ å›ºæ£€æŸ¥æ¸…å•


**ğŸ”¹ ç½‘ç»œå®‰å…¨æ£€æŸ¥**ï¼š
```
â˜‘ï¸ é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œé™åˆ¶æ•°æ®åº“ç«¯å£è®¿é—®
â˜‘ï¸ ä¿®æ”¹é»˜è®¤ç«¯å£ï¼Œé¿å…ä½¿ç”¨3306/5432
â˜‘ï¸ é…ç½®IPç™½åå•ï¼Œç¦æ­¢ä¸å¿…è¦çš„ç½‘ç»œè®¿é—®
â˜‘ï¸ å¯ç”¨SSL/TLSåŠ å¯†è¿æ¥
â˜‘ï¸ éªŒè¯è¯ä¹¦é…ç½®å’Œå®‰å…¨æ€§
```

**ğŸ”¹ è®¤è¯å’Œæˆæƒæ£€æŸ¥**ï¼š
```  
â˜‘ï¸ åˆ é™¤é»˜è®¤ç”¨æˆ·å’Œç©ºå¯†ç ç”¨æˆ·
â˜‘ï¸ å®æ–½å¼ºå¯†ç ç­–ç•¥å’Œå®šæœŸè½®æ¢
â˜‘ï¸ é…ç½®ç”¨æˆ·æƒé™æœ€å°åŒ–åŸåˆ™
â˜‘ï¸ å¯ç”¨åŒå› å­è®¤è¯ï¼ˆå¦‚æœæ”¯æŒï¼‰
â˜‘ï¸ å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™å’Œè®¿é—®è®°å½•
```

**ğŸ”¹ æ•°æ®ä¿æŠ¤æ£€æŸ¥**ï¼š
```
â˜‘ï¸ åŠ å¯†å­˜å‚¨æ•æ„Ÿæ•°æ®å­—æ®µ
â˜‘ï¸ é…ç½®æ•°æ®åº“å®¡è®¡æ—¥å¿—
â˜‘ï¸ å®æ–½å¤‡ä»½æ–‡ä»¶åŠ å¯†å’Œå®‰å…¨å­˜å‚¨
â˜‘ï¸ é…ç½®æ–‡ä»¶æƒé™é˜²æ­¢æœªæˆæƒè®¿é—®
â˜‘ï¸ å®šæœŸè¿›è¡Œå®‰å…¨æ¼æ´æ‰«æ
```

### 11.4 æŒç»­å®‰å…¨ç»´æŠ¤


**ğŸ”„ æ—¥å¸¸å®‰å…¨æ“ä½œ**ï¼š
- **æ¯æ—¥**ï¼šæ£€æŸ¥å®¡è®¡æ—¥å¿—å¼‚å¸¸ï¼Œç›‘æ§ç³»ç»ŸçŠ¶æ€
- **æ¯å‘¨**ï¼šåˆ†æå®‰å…¨äº‹ä»¶ï¼Œæ›´æ–°å¨èƒæƒ…æŠ¥
- **æ¯æœˆ**ï¼šè¿›è¡Œæƒé™å®¡æŸ¥ï¼Œæµ‹è¯•å¤‡ä»½æ¢å¤
- **æ¯å­£åº¦**ï¼šæ‰§è¡Œæ¸—é€æµ‹è¯•ï¼Œæ›´æ–°å®‰å…¨ç­–ç•¥
- **æ¯å¹´**ï¼šå…¨é¢å®‰å…¨è¯„ä¼°ï¼Œåˆ¶å®šæ”¹è¿›è®¡åˆ’

**ğŸ“Š å®‰å…¨æŒ‡æ ‡ç›‘æ§**ï¼š
```
å…³é”®å®‰å…¨æŒ‡æ ‡ï¼š
ğŸ”¸ å¤±è´¥ç™»å½•æ¬¡æ•° < 10æ¬¡/å°æ—¶
ğŸ”¸ é•¿æ—¶é—´è¿è¡ŒæŸ¥è¯¢ < 5ä¸ª/å°æ—¶  
ğŸ”¸ æƒé™å˜æ›´é¢‘ç‡ < 2æ¬¡/å¤©
ğŸ”¸ å¤‡ä»½æˆåŠŸç‡ > 99%
ğŸ”¸ SSLè¿æ¥æ¯”ä¾‹ > 95%
ğŸ”¸ å®‰å…¨è¡¥ä¸æ›´æ–° < 7å¤©å»¶è¿Ÿ
```

### 11.5 åº”æ€¥å“åº”å‡†å¤‡


**ğŸš¨ å®‰å…¨äº‹ä»¶åº”æ€¥æµç¨‹**ï¼š
```
å‘ç°å®‰å…¨å¨èƒ â†’ ç«‹å³éš”ç¦» â†’ è¯„ä¼°å½±å“ â†’ ä¿®å¤æ¼æ´ â†’ æ¢å¤æœåŠ¡ â†’ æ€»ç»“æ”¹è¿›

åº”æ€¥è”ç³»æ–¹å¼ï¼š
- æŠ€æœ¯è´Ÿè´£äººç”µè¯ï¼šxxxxx
- å®‰å…¨å›¢é˜Ÿé‚®ç®±ï¼šsecurity@company.com  
- åº”æ€¥å¤„ç†ç¾¤ç»„ï¼šEmergency-DB-Team
```

**ğŸ”§ åº”æ€¥å·¥å…·å‡†å¤‡**ï¼š
```bash
# åº”æ€¥å“åº”å·¥å…·åŒ…
/emergency/
â”œâ”€â”€ block_ip.sh          # å¿«é€ŸIPå°ç¦è„šæœ¬
â”œâ”€â”€ kill_sessions.sh     # ç»ˆæ­¢å¯ç–‘ä¼šè¯è„šæœ¬  
â”œâ”€â”€ backup_emergency.sh  # ç´§æ€¥å¤‡ä»½è„šæœ¬
â”œâ”€â”€ restore_config.sh    # é…ç½®æ¢å¤è„šæœ¬
â””â”€â”€ incident_report.py   # äº‹ä»¶æŠ¥å‘Šç”Ÿæˆå·¥å…·
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æ•°æ®åº“å®‰å…¨åŠ å›ºæ˜¯**ç³»ç»Ÿå·¥ç¨‹**ï¼Œéœ€è¦å¤šå±‚é˜²æŠ¤é…åˆ
- **é¢„é˜²èƒœäºæ²»ç–—**ï¼Œäº‹å‰é˜²æŠ¤æ¯”äº‹åä¿®å¤æ›´é‡è¦  
- **æŒç»­æ”¹è¿›**ï¼Œå®‰å…¨åŠ å›ºä¸æ˜¯ä¸€æ¬¡æ€§å·¥ä½œè€Œæ˜¯æŒç»­è¿‡ç¨‹
- **äººå‘˜åŸ¹è®­**åŒæ ·é‡è¦ï¼ŒæŠ€æœ¯æ‰‹æ®µéœ€è¦äººå‘˜æ­£ç¡®æ‰§è¡Œ
- **å®šæœŸæ¼”ç»ƒ**ï¼Œç¡®ä¿å®‰å…¨æªæ–½åœ¨çœŸå®å¨èƒä¸‹æœ‰æ•ˆ