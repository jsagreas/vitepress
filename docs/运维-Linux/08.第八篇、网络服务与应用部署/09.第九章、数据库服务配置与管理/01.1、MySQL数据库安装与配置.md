---
title: 1、MySQL数据库安装与配置
---
## 📚 目录

1. [MySQL简介与版本选择](#1-MySQL简介与版本选择)
2. [软件包安装方法](#2-软件包安装方法)
3. [数据库初始化配置](#3-数据库初始化配置)
4. [配置文件详解](#4-配置文件详解)
5. [服务管理与安全配置](#5-服务管理与安全配置)
6. [网络与字符集配置](#6-网络与字符集配置)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🗄️ MySQL简介与版本选择


### 1.1 什么是MySQL


> **MySQL**：世界上最流行的开源关系型数据库管理系统，由瑞典MySQL AB公司开发，现在归Oracle公司所有。

MySQL就像一个**数字化的文件柜**，专门用来**存储、管理和检索数据**。想象一下：
- 传统纸质档案需要人工整理和查找
- MySQL可以自动管理海量数据，瞬间找到你需要的信息
- 支持多个应用程序同时使用，就像多个人可以同时查阅不同的文件

### 1.2 MySQL vs MariaDB选择


**🔍 版本对比分析**

| **特性对比** | **MySQL** | **MariaDB** | **说明** |
|-------------|-----------|-------------|---------|
| **开发公司** | Oracle公司 | MariaDB基金会 | MariaDB是MySQL创始人的新项目 |
| **开源程度** | 双许可证 | 完全开源 | MariaDB更加开放 |
| **性能表现** | 稳定成熟 | 优化更激进 | 两者性能相近 |
| **兼容性** | 官方标准 | 高度兼容MySQL | 可以直接替换MySQL |
| **企业支持** | Oracle官方 | 社区+商业支持 | 都有企业级支持 |

> **💡 选择建议**：
> - **新项目**：推荐MariaDB，完全开源且性能更好
> - **老项目**：继续使用MySQL，稳定可靠
> - **企业环境**：根据现有技术栈选择

### 1.3 版本规划与LTS选择


**📊 MySQL版本发布规律**

```
MySQL版本生命周期：

8.0 LTS ────────────────────────── (2025年前主流)
     │
     ├─ 8.0.35 (Bug修复版本)
     ├─ 8.0.36 (安全更新)
     └─ 8.0.37 (功能增强)

5.7 ────────────────── (已停止支持)
```

**🎯 版本选择原则**
- **生产环境**：选择LTS长期支持版本（如8.0.x）
- **开发测试**：可以使用较新的稳定版本
- **学习环境**：建议使用8.0以上版本，功能更完整

---

## 2. 📦 软件包安装方法


### 2.1 yum安装方式（CentOS/RHEL）


**🔧 官方yum源安装（推荐）**

```bash
# 第一步：下载并安装MySQL官方yum仓库
wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
sudo rpm -ivh mysql80-community-release-el7-3.noarch.rpm

# 第二步：更新yum缓存
sudo yum update

# 第三步：安装MySQL服务器
sudo yum install mysql-community-server
```

**⚙️ 系统默认源安装**

```bash
# CentOS 7默认安装MariaDB
sudo yum install mariadb-server mariadb

# 如果需要MySQL，先移除MariaDB
sudo yum remove mariadb*
```

> **⚠️ 注意**：CentOS 8开始，默认使用`dnf`包管理器，命令基本相同，将`yum`替换为`dnf`即可。

### 2.2 apt安装方式（Ubuntu/Debian）


**🐧 Ubuntu系统安装**

```bash
# 更新软件包索引
sudo apt update

# 安装MySQL服务器
sudo apt install mysql-server

# 安装MySQL客户端（通常会自动安装）
sudo apt install mysql-client
```

**🎯 指定版本安装**

```bash
# 添加MySQL APT仓库
wget https://dev.mysql.com/get/mysql-apt-config_0.8.22-1_all.deb
sudo dpkg -i mysql-apt-config_0.8.22-1_all.deb

# 更新并安装指定版本
sudo apt update
sudo apt install mysql-server=8.0.35-0ubuntu0.20.04.1
```

### 2.3 源码编译安装


**🏗️ 编译安装适用场景**
- 需要自定义编译参数
- 特定的性能优化需求
- 官方包不支持的系统版本

```bash
# 安装编译依赖
sudo yum install gcc gcc-c++ cmake ncurses-devel openssl-devel

# 下载源码
wget https://downloads.mysql.com/archives/mysql-8.0/mysql-8.0.35.tar.gz
tar -xzf mysql-8.0.35.tar.gz
cd mysql-8.0.35

# 编译配置
cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
        -DMYSQL_DATADIR=/usr/local/mysql/data \
        -DWITH_SSL=system

# 编译安装
make -j$(nproc)
sudo make install
```

> **💡 编译说明**：源码编译时间较长（30分钟-2小时），适合对性能有特殊要求的场景。

### 2.4 安装方式对比选择


| **安装方式** | **优点** | **缺点** | **适用场景** |
|-------------|---------|---------|-------------|
| **yum/apt包管理** | 简单快速，自动处理依赖 | 版本可能不是最新 | 大部分生产环境 |
| **官方仓库** | 版本新，官方支持 | 需要添加第三方源 | 需要新特性时 |
| **源码编译** | 高度自定义，性能优化 | 复杂耗时，维护困难 | 特殊性能需求 |

---

## 3. 🔧 数据库初始化配置


### 3.1 MySQL初始化过程


**📋 初始化步骤说明**

MySQL安装后需要进行**数据库初始化**，这个过程会：
1. 创建系统数据库（mysql、information_schema、performance_schema等）
2. 设置root用户和初始密码
3. 创建数据存储目录结构
4. 生成必要的系统表和权限表

```bash
# MySQL 8.0初始化命令
sudo mysqld --initialize --user=mysql --datadir=/var/lib/mysql

# 或者使用mysql_install_db（老版本）
sudo mysql_install_db --user=mysql --datadir=/var/lib/mysql
```

### 3.2 获取初始root密码


**🔑 密码获取方法**

MySQL 8.0会在初始化时**自动生成随机root密码**：

```bash
# 方法1：查看错误日志文件
sudo grep 'temporary password' /var/log/mysqld.log

# 输出示例：
# 2025-01-15T10:30:45.123456Z 6 [Note] [MY-010454] A temporary password is generated for root@localhost: kL4#mN9pQ2xR
```

```bash
# 方法2：检查系统消息
sudo journalctl -u mysqld | grep password
```

> **💡 重要提示**：这个临时密码只能用于**首次登录**，登录后必须立即修改密码才能进行其他操作。

### 3.3 首次登录与密码修改


**🔐 修改root密码流程**

```bash
# 第一步：使用临时密码登录
mysql -u root -p
# 输入刚才获取的临时密码

# 第二步：修改root密码（登录MySQL后执行）
ALTER USER 'root'@'localhost' IDENTIFIED BY 'your_strong_password';

# 第三步：刷新权限
FLUSH PRIVILEGES;

# 第四步：退出MySQL
exit;
```

**🛡️ 密码安全要求**

MySQL 8.0默认启用密码验证插件，密码必须满足：
- 长度至少8个字符
- 包含大写字母、小写字母、数字和特殊字符
- 不能是常见的弱密码

```sql
-- 查看密码策略
SHOW VARIABLES LIKE 'validate_password%';

-- 临时降低密码复杂度（仅测试环境）
SET GLOBAL validate_password.policy = LOW;
SET GLOBAL validate_password.length = 6;
```

---

## 4. ⚙️ 配置文件详解


### 4.1 my.cnf配置文件位置


**📁 配置文件搜索顺序**

MySQL按照以下顺序查找配置文件：

```
配置文件优先级（从高到低）：

/etc/mysql/my.cnf          ← 最高优先级
/etc/my.cnf                ← 系统全局配置
~/.my.cnf                  ← 用户个人配置
命令行参数                  ← 最高优先级（运行时）
```

**🔍 查找当前使用的配置文件**

```bash
# 查看MySQL读取的配置文件
mysqld --help --verbose | grep -A 1 'Default options'

# 或者查看MySQL启动参数
ps aux | grep mysqld
```

### 4.2 核心配置参数详解


**🎯 /etc/my.cnf基础配置模板**

```ini
[client]
# 客户端默认字符集
default-character-set = utf8mb4
# 客户端连接端口
port = 3306

[mysql]
# mysql命令行工具字符集
default-character-set = utf8mb4

[mysqld]
# === 基础设置 ===
# 服务器端口号
port = 3306
# MySQL安装目录
basedir = /usr
# 数据存储目录
datadir = /var/lib/mysql
# socket文件位置
socket = /var/lib/mysql/mysql.sock
# PID文件位置
pid-file = /var/run/mysqld/mysqld.pid

# === 字符集设置 ===
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# === 网络设置 ===
# 绑定IP地址（0.0.0.0表示所有IP）
bind-address = 127.0.0.1
# 最大连接数
max_connections = 200
# 连接超时时间
wait_timeout = 600

# === 内存设置 ===
# InnoDB缓冲池大小（建议为总内存的70-80%）
innodb_buffer_pool_size = 1G
# 查询缓存大小
query_cache_size = 64M

# === 日志设置 ===
# 错误日志
log-error = /var/log/mysqld.log
# 慢查询日志
slow_query_log = 1
slow_query_log_file = /var/log/mysql-slow.log
long_query_time = 2

# === 安全设置 ===
# 禁用本地文件加载
local-infile = 0
# 符号链接安全
symbolic-links = 0
```

### 4.3 重要参数含义解释


**💾 内存相关参数**

| **参数名** | **作用说明** | **设置建议** |
|-----------|-------------|-------------|
| `innodb_buffer_pool_size` | InnoDB存储引擎的缓冲池，缓存表数据和索引 | 总内存的70-80% |
| `query_cache_size` | 查询结果缓存大小 | 小型系统32-64M |
| `max_connections` | 最大并发连接数 | 根据实际需求，通常100-500 |
| `thread_cache_size` | 线程缓存大小 | 连接数的10% |

**📝 日志相关参数**

```ini
# 二进制日志（用于复制和备份）
log-bin = mysql-bin
binlog_format = ROW
expire_logs_days = 7

# 通用查询日志（调试用）
general_log = 0
general_log_file = /var/log/mysql-general.log
```

> **⚠️ 注意**：通用查询日志会记录所有SQL语句，包含密码，生产环境建议关闭。

---

## 5. 🚀 服务管理与安全配置


### 5.1 服务启动停止管理


**⚙️ systemd服务管理**

```bash
# 启动MySQL服务
sudo systemctl start mysqld

# 停止MySQL服务  
sudo systemctl stop mysqld

# 重启MySQL服务
sudo systemctl restart mysqld

# 查看服务状态
sudo systemctl status mysqld

# 设置开机自启动
sudo systemctl enable mysqld

# 禁用开机自启动
sudo systemctl disable mysqld
```

**🔍 服务状态检查**

```bash
# 检查MySQL进程
ps aux | grep mysql

# 检查端口占用
netstat -tulnp | grep 3306
# 或者使用ss命令
ss -tulnp | grep 3306

# 检查MySQL连接
mysql -u root -p -e "SELECT VERSION();"
```

### 5.2 数据目录权限配置


**🔒 权限安全设置**

MySQL数据目录的权限设置非常重要，**权限过宽会导致安全风险**，**权限不足会导致服务无法启动**。

```bash
# 创建mysql用户（如果不存在）
sudo useradd -r -g mysql -s /bin/false mysql

# 设置数据目录所有者
sudo chown -R mysql:mysql /var/lib/mysql

# 设置适当的权限
sudo chmod 755 /var/lib/mysql
sudo chmod 600 /var/lib/mysql/*

# 检查权限设置
ls -la /var/lib/mysql/
```

**📋 权限说明**

| **目录/文件** | **权限** | **说明** |
|--------------|---------|---------|
| `/var/lib/mysql/` | 755 (rwxr-xr-x) | 数据目录，mysql用户可读写执行 |
| 数据文件 | 600 (rw-------) | 只有mysql用户可读写 |
| 日志文件 | 640 (rw-r-----) | mysql用户读写，mysql组可读 |

### 5.3 mysql_secure_installation安全配置


**🛡️ 安全初始化向导**

`mysql_secure_installation`是MySQL官方提供的**安全配置工具**，会引导你完成基础安全设置：

```bash
# 运行安全配置向导
sudo mysql_secure_installation
```

**📋 配置向导内容**

```
安全配置项目说明：

1. 设置root密码强度
   ├─ 启用密码验证插件？ [建议：Yes]
   └─ 设置密码验证级别 [建议：MEDIUM]

2. 更改root密码
   ├─ 当前密码是否满足要求？
   └─ 是否修改为更强的密码？ [建议：Yes]

3. 删除匿名用户
   ├─ 匿名用户带来安全风险
   └─ 删除匿名用户？ [建议：Yes]

4. 禁止root远程登录
   ├─ 防止root用户从网络登录
   └─ 禁止root远程登录？ [建议：Yes，生产环境]

5. 删除test数据库
   ├─ test数据库允许任何用户访问
   └─ 删除test数据库？ [建议：Yes]

6. 重新加载权限表
   └─ 使所有更改立即生效 [建议：Yes]
```

**⚡ 手动执行等效操作**

如果不使用向导，也可以手动执行这些安全设置：

```sql
-- 删除匿名用户
DELETE FROM mysql.user WHERE User='';

-- 删除test数据库
DROP DATABASE IF EXISTS test;
DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';

-- 禁止root远程登录
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');

-- 刷新权限
FLUSH PRIVILEGES;
```

---

## 6. 🌐 网络与字符集配置


### 6.1 端口与网络绑定设置


**🔌 端口配置说明**

MySQL默认使用**3306端口**，这是IANA（互联网号码分配局）正式分配给MySQL的端口号。

```ini
[mysqld]
# 监听端口
port = 3306

# 绑定IP地址设置
bind-address = 127.0.0.1    # 仅本机访问
# bind-address = 0.0.0.0    # 允许所有IP访问
# bind-address = 192.168.1.100  # 仅指定IP访问
```

**🌍 网络访问控制**

```bash
# 检查当前绑定状态
netstat -tlnp | grep 3306

# 输出示例：
# tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN 12345/mysqld
#          ↑ 只绑定本地回环地址

# tcp 0 0 0.0.0.0:3306   0.0.0.0:* LISTEN 12345/mysqld  
#          ↑ 绑定所有网络接口
```

**🔥 防火墙配置**

```bash
# CentOS 7防火墙设置
sudo firewall-cmd --permanent --add-port=3306/tcp
sudo firewall-cmd --reload

# Ubuntu防火墙设置
sudo ufw allow 3306/tcp

# 检查防火墙状态
sudo firewall-cmd --list-ports
```

### 6.2 字符集配置详解


**🔤 为什么字符集很重要**

字符集决定了MySQL能存储什么类型的文字：
- **latin1**：只支持英文和少数西欧字符
- **utf8**：支持大部分Unicode字符，但**不完整**（不支持emoji等）
- **utf8mb4**：完整的UTF-8实现，支持所有Unicode字符，**推荐使用**

**⚙️ 字符集配置设置**

```ini
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
# 服务器默认字符集
character-set-server = utf8mb4
# 默认排序规则
collation-server = utf8mb4_unicode_ci
# 初始化连接字符集
init-connect = 'SET NAMES utf8mb4'
# 客户端字符集
character-set-client-handshake = FALSE
```

**🔍 检查字符集设置**

```sql
-- 查看所有字符集变量
SHOW VARIABLES LIKE 'character%';
SHOW VARIABLES LIKE 'collation%';

-- 查看数据库字符集
SELECT DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME 
FROM information_schema.SCHEMATA 
WHERE SCHEMA_NAME = 'your_database';
```

### 6.3 时区配置


**⏰ 时区设置重要性**

时区配置影响：
- 时间函数（NOW(), CURDATE()等）的返回值
- 时间戳字段的存储和显示
- 定时任务的执行时间

```sql
-- 查看当前时区设置
SELECT $$global.time_zone, $$session.time_zone;

-- 设置全局时区（需要root权限）
SET GLOBAL time_zone = '+08:00';  -- 设置为东八区

-- 设置会话时区
SET time_zone = '+08:00';
```

**🌍 系统时区配置**

```bash
# 查看系统时区
timedatectl status

# 设置系统时区
sudo timedatectl set-timezone Asia/Shanghai

# MySQL配置文件中设置时区
[mysqld]
default-time-zone = '+08:00'
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 安装方式：包管理器安装最简单，源码编译最灵活
🔸 初始化：数据库初始化会创建系统表和临时root密码
🔸 配置文件：/etc/my.cnf控制MySQL所有行为参数
🔸 服务管理：使用systemctl管理MySQL服务生命周期
🔸 安全配置：mysql_secure_installation完成基础安全设置
🔸 权限管理：数据目录权限必须正确设置为mysql用户
🔸 网络配置：bind-address控制网络访问范围
🔸 字符集：推荐使用utf8mb4支持完整Unicode
```

### 7.2 关键理解要点


**🔹 MySQL安装后的必做事项**
```
1. 获取并修改初始root密码
2. 运行mysql_secure_installation安全向导
3. 配置适当的字符集和时区
4. 设置合理的内存参数
5. 配置日志记录
6. 测试数据库连接
```

**🔹 配置文件优先级理解**
```
配置优先级：命令行参数 > ~/.my.cnf > /etc/my.cnf > 编译默认值
这意味着用户配置会覆盖系统配置，命令行参数优先级最高
```

**🔹 安全配置的核心原则**
```
最小权限原则：只给必需的权限，不多给
网络隔离：生产环境不要bind-address=0.0.0.0  
强密码策略：启用密码复杂度验证
日志监控：启用慢查询和错误日志
```

### 7.3 实际应用场景


**💼 生产环境部署清单**
- **硬件规划**：根据数据量规划内存和存储
- **网络安全**：配置防火墙和网络ACL
- **备份策略**：设置定期备份和binlog
- **监控告警**：部署数据库监控系统
- **高可用**：考虑主从复制或集群部署

**🛠️ 开发环境快速搭建**
- **Docker部署**：使用容器快速启动MySQL
- **本地开发**：bind-address=127.0.0.1确保安全
- **测试数据**：准备测试数据库和用户
- **开发工具**：配置数据库连接工具

### 7.4 常见问题与解决


**⚠️ 新手常遇到的问题**
```
密码问题：忘记临时密码 → 查看/var/log/mysqld.log
权限问题：服务启动失败 → 检查数据目录权限
网络问题：无法连接 → 检查bind-address和防火墙
字符集问题：中文乱码 → 配置utf8mb4字符集
```

**💡 最佳实践建议**
```
配置管理：使用版本控制管理配置文件
参数调优：根据实际负载逐步调整参数
安全更新：定期更新MySQL版本和安全补丁
备份验证：定期测试备份文件的完整性
文档记录：记录所有配置变更和运维操作
```

**核心记忆口诀**：
```
MySQL装好先初始，临时密码要牢记
安全向导跑一遍，root权限要限制  
配置文件my.cnf，字符集用utf8mb4
服务管理systemctl，开机启动别忘记
网络绑定看需求，防火墙端口要开启
```