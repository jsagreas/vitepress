---
title: 1、系统安全基线配置
---
## 📚 目录

1. [安全基线配置概述](#1-安全基线配置概述)
2. [最小化安装与服务管理](#2-最小化安装与服务管理)
3. [账户安全策略配置](#3-账户安全策略配置)
4. [文件系统权限基线](#4-文件系统权限基线)
5. [网络服务安全配置](#5-网络服务安全配置)
6. [内核参数安全优化](#6-内核参数安全优化)
7. [系统更新与补丁管理](#7-系统更新与补丁管理)
8. [审计与日志配置](#8-审计与日志配置)
9. [系统资源限制配置](#9-系统资源限制配置)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🛡️ 安全基线配置概述


### 1.1 什么是系统安全基线


**💡 基线的本质含义**
> 安全基线就像给系统定制一套"安全规范"，就好比给房子装防盗门、安监控一样，是为了保护系统不被恶意攻击或误操作破坏。

**🎯 安全基线的核心目标**

```
系统安全防护体系：

         外部威胁防护
              ↓
    ┌─────────────────────────┐
    │      网络层防护          │ ← 防火墙、端口控制
    ├─────────────────────────┤
    │      系统层防护          │ ← 账户控制、权限管理
    ├─────────────────────────┤
    │      应用层防护          │ ← 服务加固、配置安全
    ├─────────────────────────┤
    │      数据层防护          │ ← 文件权限、加密存储
    └─────────────────────────┘
              ↑
         内部安全控制
```

**⭐ 安全基线的三大价值**

| **价值** | **具体含义** | **实际效果** |
|---------|-------------|-------------|
| 🔒 **预防攻击** | 关闭不需要的服务和端口 | 减少被攻击的入口点 |
| 📊 **合规要求** | 满足行业安全标准 | 通过安全审计和认证 |
| 🎯 **风险控制** | 建立统一的安全标准 | 降低人为配置错误 |

### 1.2 安全基线的分类体系


**📋 基线配置的层次结构**

```
安全基线配置层次：

基础安全层
├── 系统安装配置
├── 账户权限管理
└── 基础服务控制

网络安全层
├── 防火墙策略
├── 网络服务配置
└── 通信加密设置

应用安全层
├── 软件版本管理
├── 配置文件安全
└── 日志审计配置

数据安全层
├── 文件权限控制
├── 数据备份策略
└── 敏感信息保护
```

---

## 2. 📦 最小化安装与服务管理


### 2.1 最小化安装原则


**🎯 为什么要最小化安装**
> 想象一下，你家里只放需要用的东西，这样小偷就没那么多东西可偷。系统也是一样，只装必需的软件，黑客能利用的漏洞就越少。

**✨ 最小化安装的核心思路**

```
软件安装决策流程：

需要安装软件？
       ↓
   是否必需？ ──否──→ 不安装
       ↓是
   是否安全？ ──否──→ 寻找替代方案
       ↓是
   定期使用？ ──否──→ 考虑临时安装
       ↓是
     安装
```

**🔧 CentOS/RHEL最小化安装检查**

```bash
# 查看已安装的软件包数量
rpm -qa | wc -l

# 查看大型软件包（占用空间较多）
rpm -qa --queryformat '%{SIZE} %{NAME}\n' | sort -rn | head -20

# 检查不必要的桌面环境
rpm -qa | grep -E "gnome|kde|xorg"
```

**📊 常见不必要服务清单**

| **服务类型** | **服务名称** | **用途** | **建议操作** |
|-------------|-------------|---------|-------------|
| **桌面环境** | `gdm`, `lightdm` | 图形界面管理器 | 服务器环境禁用 |
| **打印服务** | `cups` | 打印机支持 | 无打印需求时禁用 |
| **邮件服务** | `postfix` | 邮件传输 | 非邮件服务器禁用 |
| **蓝牙服务** | `bluetooth` | 蓝牙连接 | 服务器环境禁用 |
| **音频服务** | `pulseaudio` | 音频处理 | 服务器环境禁用 |

### 2.2 服务管理与控制


**🎮 systemd服务管理基础**

```bash
# 查看所有服务状态
systemctl list-unit-files --type=service

# 查看正在运行的服务
systemctl list-units --type=service --state=running

# 禁用不需要的服务
systemctl disable bluetooth
systemctl stop bluetooth

# 查看服务是否禁用成功
systemctl is-enabled bluetooth
```

**⚠️ 服务禁用注意事项**

> **重要提醒**：禁用服务前要确认不会影响系统正常运行。就像拆房子的零件一样，有些看起来不重要，但拆了可能整个系统都不工作了。

**🔍 安全服务检查清单**

```bash
# 检查网络服务监听端口
ss -tlnp | grep LISTEN

# 查看开机自启动的服务
systemctl list-unit-files --state=enabled --type=service

# 检查用户自定义的定时任务
crontab -l
ls -la /var/spool/cron/
```

---

## 3. 👥 账户安全策略配置


### 3.1 默认账户安全处理


**🔐 为什么要处理默认账户**
> 系统默认账户就像房子的万能钥匙，如果不妥善处理，就给了坏人进入系统的机会。

**🎯 默认账户处理策略**

```
账户安全处理流程：

系统默认账户
       ↓
   是否必需？
   /        \
  是        否
  ↓         ↓
保留但加固   删除或禁用
  ↓         ↓
修改密码    锁定账户
设置权限    禁用登录
```

**🔧 常见系统账户处理**

```bash
# 查看系统所有用户账户
cat /etc/passwd | cut -d: -f1

# 查看可登录的用户账户
cat /etc/passwd | grep -v nologin | grep -v false

# 锁定不必要的系统账户
usermod -L daemon
usermod -s /sbin/nologin daemon

# 检查空密码账户
awk -F: '($2 == "") {print $1}' /etc/shadow
```

**⚡ 危险账户识别**

| **账户类型** | **风险等级** | **处理建议** | **检查方法** |
|-------------|-------------|-------------|-------------|
| **空密码账户** | 🔴 极高 | 立即设置密码或禁用 | `awk -F: '($2=="") {print}' /etc/shadow` |
| **UID=0账户** | 🔴 极高 | 只保留root，其他删除 | `awk -F: '($3==0) {print}' /etc/passwd` |
| **默认账户** | 🟡 中等 | 评估后禁用或删除 | 检查guest、test等账户 |
| **服务账户** | 🟢 低 | 禁止登录，最小权限 | 设置nologin shell |

### 3.2 密码安全策略


**🔑 密码策略的重要性**
> 密码就像家门钥匙，太简单容易被复制，太复杂自己记不住。好的密码策略就是找到安全和易用的平衡点。

**📋 密码复杂度配置**

```bash
# 编辑密码策略配置文件
vim /etc/security/pwquality.conf

# 主要配置项
minlen = 8          # 最小长度8位
minclass = 3        # 至少包含3种字符类型
maxrepeat = 3       # 相同字符最多连续3个
```

**⏰ 密码有效期设置**

```bash
# 设置密码有效期策略
vim /etc/login.defs

PASS_MAX_DAYS   90      # 密码最长有效期90天
PASS_MIN_DAYS   1       # 密码最短使用期1天
PASS_MIN_LEN    8       # 密码最小长度8位
PASS_WARN_AGE   7       # 密码过期前7天警告
```

**🚨 账户锁定策略**

```bash
# 配置登录失败锁定
vim /etc/pam.d/system-auth

# 添加以下行
auth required pam_faillock.so deny=5 unlock_time=300
```

---

## 4. 📁 文件系统权限基线


### 4.1 关键目录权限控制


**🏠 文件权限的基本概念**
> 文件权限就像房间的门锁，决定了谁能进入、谁能查看、谁能修改。合理的权限设置能防止重要文件被误删或恶意修改。

**📊 重要目录权限基线表**

| **目录路径** | **权限设置** | **所有者** | **安全原因** |
|-------------|-------------|-----------|-------------|
| `/etc/passwd` | `644 (rw-r--r--)` | `root:root` | 用户信息需要可读，但只有root能修改 |
| `/etc/shadow` | `000 (---------)` | `root:root` | 密码信息高度敏感，严格限制访问 |
| `/etc/ssh/` | `755 (rwxr-xr-x)` | `root:root` | SSH配置目录，防止未授权修改 |
| `/var/log/` | `755 (rwxr-xr-x)` | `root:root` | 日志目录，确保日志完整性 |
| `/tmp/` | `1777 (rwxrwxrwt)` | `root:root` | 临时目录，sticky位防止恶意删除 |

**🔧 权限检查与修复**

```bash
# 检查关键文件权限
ls -l /etc/passwd /etc/shadow /etc/group

# 修复权限设置
chmod 644 /etc/passwd
chmod 000 /etc/shadow
chmod 644 /etc/group

# 检查SUID/SGID文件
find / -type f \( -perm -4000 -o -perm -2000 \) -exec ls -l {} \;
```

### 4.2 特殊权限控制


**⚡ SUID/SGID权限管理**
> SUID权限就像"临时通行证"，让普通用户临时获得程序所有者的权限。这很有用，但也很危险，需要严格控制。

**🎯 危险SUID程序检查**

```bash
# 查找系统中的SUID程序
find / -type f -perm -4000 -ls 2>/dev/null

# 常见需要检查的SUID程序
ls -l /usr/bin/passwd      # 改密码需要root权限
ls -l /usr/bin/su          # 切换用户需要验证
ls -l /usr/bin/sudo        # 执行管理员命令
```

**🚨 权限异常排查**

```bash
# 检查世界可写的文件（高风险）
find / -type f -perm -002 -exec ls -l {} \;

# 检查没有所有者的文件
find / -nouser -o -nogroup

# 检查隐藏文件
find / -name ".*" -type f
```

---

## 5. 🌐 网络服务安全配置


### 5.1 防火墙基础配置


**🛡️ 防火墙的作用**
> 防火墙就像小区的保安，检查每个想进入系统的网络连接，只允许安全的连接通过，阻挡可疑的访问。

**🔥 firewalld基本管理**

```bash
# 查看防火墙状态
systemctl status firewalld
firewall-cmd --state

# 查看当前配置
firewall-cmd --list-all

# 开放必要端口
firewall-cmd --add-port=22/tcp --permanent    # SSH
firewall-cmd --add-port=80/tcp --permanent    # HTTP
firewall-cmd --add-port=443/tcp --permanent   # HTTPS

# 重载配置
firewall-cmd --reload
```

**📋 端口开放原则**

```
端口开放决策流程：

需要开放端口？
       ↓
   业务必需？ ──否──→ 不开放
       ↓是
   限制来源IP？ ──是──→ 添加源IP限制
       ↓否
   所有IP访问？ ──慎重考虑──→ 开放并监控
```

### 5.2 SSH服务安全配置


**🔐 SSH安全配置要点**

```bash
# 编辑SSH配置文件
vim /etc/ssh/sshd_config

# 重要安全配置项
Port 22022                    # 修改默认端口
PermitRootLogin no           # 禁止root直接登录
PasswordAuthentication no    # 禁用密码登录（推荐密钥）
MaxAuthTries 3              # 最大认证尝试次数
ClientAliveInterval 300     # 客户端活跃检查间隔
```

**🔑 SSH密钥认证配置**

```bash
# 生成密钥对
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# 复制公钥到服务器
ssh-copy-id -i ~/.ssh/id_rsa.pub user@server

# 验证密钥登录
ssh -i ~/.ssh/id_rsa user@server
```

---

## 6. ⚙️ 内核参数安全优化


### 6.1 网络安全参数


**🌐 网络参数优化的意义**
> 内核参数就像系统的"行为规则"，通过调整这些参数，能让系统更好地抵御网络攻击，就像给系统装上更智能的安全系统。

**🔧 关键网络安全参数**

```bash
# 编辑内核参数配置
vim /etc/sysctl.conf

# 防止IP转发
net.ipv4.ip_forward = 0

# 防止ICMP重定向攻击
net.ipv4.conf.all.accept_redirects = 0
net.ipv6.conf.all.accept_redirects = 0

# 防止源路由攻击
net.ipv4.conf.all.accept_source_route = 0

# 启用SYN cookies防护
net.ipv4.tcp_syncookies = 1

# 应用配置
sysctl -p
```

**📊 网络参数配置说明表**

| **参数名称** | **推荐值** | **安全作用** |
|-------------|-----------|-------------|
| `net.ipv4.ip_forward` | `0` | 禁止IP转发，防止系统被当作路由器 |
| `net.ipv4.tcp_syncookies` | `1` | 防止SYN flood攻击 |
| `net.ipv4.conf.all.log_martians` | `1` | 记录异常网络包，便于分析攻击 |
| `net.ipv4.icmp_echo_ignore_broadcasts` | `1` | 忽略广播ping，防止网络扫描 |

### 6.2 系统安全参数


**🔒 进程和内存安全参数**

```bash
# 进程安全参数
kernel.dmesg_restrict = 1              # 限制dmesg访问
kernel.kptr_restrict = 2               # 隐藏内核指针
kernel.yama.ptrace_scope = 1          # 限制ptrace调试

# 内存安全参数
vm.mmap_min_addr = 65536              # 防止NULL指针攻击
kernel.randomize_va_space = 2          # 启用地址空间随机化
```

---

## 7. 🔄 系统更新与补丁管理


### 7.1 更新策略制定


**📈 为什么要及时更新**
> 系统更新就像给房子修补漏洞，软件厂商发现安全问题会发布补丁，不及时更新就像门窗有破洞却不修补，给坏人留下可乘之机。

**⚡ 更新管理流程**

```
补丁管理流程：

安全公告监控
       ↓
   风险评估
   /      \
高风险    低风险
  ↓        ↓
立即更新   计划更新
  ↓        ↓
测试验证   批量部署
  ↓        ↓
生产部署   监控观察
```

**🔧 CentOS/RHEL更新管理**

```bash
# 检查可用更新
yum check-update

# 只更新安全补丁
yum update --security

# 查看更新历史
yum history

# 设置自动更新（谨慎使用）
yum install yum-cron
systemctl enable yum-cron
```

### 7.2 补丁测试与部署


**🧪 补丁测试的重要性**
> 更新补丁前要先测试，就像试穿衣服一样，确保不会影响系统正常工作。

**📋 补丁部署检查清单**

- [ ] **备份系统**：更新前完整备份
- [ ] **测试环境验证**：先在测试环境验证
- [ ] **业务影响评估**：确认对业务的影响
- [ ] **回滚计划**：准备更新失败的回滚方案
- [ ] **监控准备**：更新后的监控和验证计划

---

## 8. 📊 审计与日志配置


### 8.1 日志系统配置


**📝 日志的重要作用**
> 日志就像监控摄像头，记录系统发生的所有重要事件。当出现问题时，日志能帮我们找出问题的原因和时间。

**🔧 rsyslog基础配置**

```bash
# 编辑rsyslog配置
vim /etc/rsyslog.conf

# 重要日志配置
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
authpriv.*                                  /var/log/secure
mail.*                                      /var/log/maillog
cron.*                                      /var/log/cron
```

**📊 重要日志文件说明**

| **日志文件** | **记录内容** | **安全价值** |
|-------------|-------------|-------------|
| `/var/log/secure` | 认证、授权相关事件 | 登录失败、权限提升等安全事件 |
| `/var/log/messages` | 系统一般信息 | 系统错误、服务状态变化 |
| `/var/log/audit/audit.log` | 系统审计事件 | 详细的系统调用和权限使用 |
| `/var/log/lastlog` | 用户最后登录时间 | 检测异常登录活动 |

### 8.2 auditd审计配置


**🔍 系统审计的价值**
> auditd审计系统就像专业的安保记录员，详细记录谁在什么时候做了什么操作，是安全事件调查的重要依据。

**⚙️ auditd基本配置**

```bash
# 启动审计服务
systemctl enable auditd
systemctl start auditd

# 查看审计规则
auditctl -l

# 添加关键文件监控
auditctl -w /etc/passwd -p wa -k passwd_changes
auditctl -w /etc/shadow -p wa -k shadow_changes
auditctl -w /etc/ssh/sshd_config -p wa -k ssh_config_changes
```

**🎯 重要审计规则示例**

```bash
# 监控用户管理操作
-w /usr/sbin/useradd -p x -k user_management
-w /usr/sbin/userdel -p x -k user_management

# 监控权限变更
-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat -k perm_mod

# 监控网络连接
-a always,exit -F arch=b64 -S connect -k network_connect
```

---

## 9. ⚖️ 系统资源限制配置


### 9.1 用户资源限制


**📊 为什么要限制资源使用**
> 资源限制就像给每个用户分配固定的"配额"，防止某个用户或程序消耗太多资源，影响系统稳定性。

**🔧 limits.conf配置**

```bash
# 编辑用户资源限制
vim /etc/security/limits.conf

# 用户进程数限制
* soft nproc 4096
* hard nproc 16384

# 文件描述符限制
* soft nofile 65536
* hard nofile 131072

# 内存使用限制
@users soft as 2097152
@users hard as 4194304
```

**📋 资源限制参数说明**

| **参数** | **含义** | **推荐值** | **安全考虑** |
|---------|---------|-----------|-------------|
| `nproc` | 用户最大进程数 | `soft:4096, hard:16384` | 防止进程炸弹攻击 |
| `nofile` | 最大文件描述符数 | `soft:65536, hard:131072` | 防止资源耗尽攻击 |
| `fsize` | 最大文件大小 | 根据业务需求 | 防止磁盘空间耗尽 |
| `cpu` | CPU时间限制 | 根据性能需求 | 防止CPU资源独占 |

### 9.2 系统资源监控


**📈 资源使用监控**

```bash
# 查看当前资源使用
ulimit -a                    # 查看当前用户限制
cat /proc/sys/fs/file-nr    # 查看系统文件描述符使用情况
ps aux --sort=-%cpu         # 按CPU使用率排序进程
ps aux --sort=-%mem         # 按内存使用率排序进程
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心概念


```
🔸 安全基线：系统安全的最低标准配置，包含账户、权限、服务、网络等方面
🔸 最小化原则：只安装和启用必需的软件和服务，减少攻击面
🔸 权限控制：合理设置文件和目录权限，防止未授权访问
🔸 网络安全：配置防火墙、SSH安全，控制网络访问
🔸 日志审计：记录系统活动，便于安全事件分析和调查
🔸 资源限制：防止资源滥用，保证系统稳定运行
```

### 10.2 关键配置检查清单


**🔍 日常安全检查要点**

- [ ] **服务状态检查**：确认只运行必需的服务
- [ ] **端口监听检查**：验证只开放必要的网络端口
- [ ] **用户账户检查**：确认没有异常账户和空密码
- [ ] **文件权限检查**：验证关键文件权限设置正确
- [ ] **日志分析**：定期查看安全相关日志
- [ ] **系统更新检查**：确保安装了最新的安全补丁

### 10.3 安全配置最佳实践


**🎯 配置优先级**

```
安全配置重要性排序：

高优先级（立即执行）：
├── 修改默认密码和账户
├── 关闭不必要的服务
├── 配置防火墙基本规则
└── 设置关键文件权限

中优先级（及时完成）：
├── 配置SSH安全参数
├── 设置日志审计规则
├── 优化内核安全参数
└── 配置资源使用限制

低优先级（逐步完善）：
├── 制定更新策略
├── 完善监控告警
├── 定期安全检查
└── 制定应急预案
```

**⚡ 实施建议**

> **分步实施**：不要一次性修改所有配置，应该分阶段、分系统地实施安全基线配置。

> **测试验证**：每次配置变更后都要测试系统功能是否正常，确保安全配置不影响业务运行。

> **文档记录**：详细记录所有配置变更，包括变更原因、时间、负责人等信息。

### 10.4 常见问题与解决方案


**🚨 配置过程中的注意事项**

| **问题类型** | **常见现象** | **解决方案** |
|-------------|-------------|-------------|
| **服务依赖** | 禁用服务后其他功能异常 | 先确认服务依赖关系 |
| **权限过严** | 程序无法正常运行 | 逐步调整权限设置 |
| **网络不通** | 配置防火墙后无法访问 | 检查端口开放情况 |
| **日志过多** | 磁盘空间快速消耗 | 配置日志轮转和清理 |

**核心记忆要点**：
- 安全基线是系统安全的底线，不是可选项
- 最小化原则：只给必要的权限，只开必要的服务
- 防御深度：多层防护比单点防护更安全
- 持续改进：安全配置需要根据威胁变化持续优化