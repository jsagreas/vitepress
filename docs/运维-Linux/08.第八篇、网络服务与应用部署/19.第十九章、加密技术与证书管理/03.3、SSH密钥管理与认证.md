---
title: 3ã€SSHå¯†é’¥ç®¡ç†ä¸Žè®¤è¯
---
## ðŸ“š ç›®å½•

1. [SSHå¯†é’¥åŸºç¡€æ¦‚å¿µ](#1-SSHå¯†é’¥åŸºç¡€æ¦‚å¿µ)
2. [å¯†é’¥å¯¹ç”Ÿæˆä¸Žç®¡ç†](#2-å¯†é’¥å¯¹ç”Ÿæˆä¸Žç®¡ç†)
3. [å¯†é’¥ç±»åž‹æ·±åº¦è§£æž](#3-å¯†é’¥ç±»åž‹æ·±åº¦è§£æž)
4. [å¯†é’¥æ–‡ä»¶æ ¼å¼ä¸Žæƒé™](#4-å¯†é’¥æ–‡ä»¶æ ¼å¼ä¸Žæƒé™)
5. [SSHä»£ç†ä¸Žå¯†é’¥ç®¡ç†](#5-SSHä»£ç†ä¸Žå¯†é’¥ç®¡ç†)
6. [å…¬é’¥è®¤è¯é…ç½®](#6-å…¬é’¥è®¤è¯é…ç½®)
7. [å¯†é’¥å®‰å…¨ç­–ç•¥](#7-å¯†é’¥å®‰å…¨ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ” SSHå¯†é’¥åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SSHå¯†é’¥


**ç®€å•ç†è§£**ï¼šSSHå¯†é’¥å°±åƒæ˜¯ä¸€æŠŠç‰¹æ®Šçš„"é’¥åŒ™"ï¼Œç”¨æ¥è¯æ˜Žä½ çš„èº«ä»½ï¼Œæ¯”ä¼ ç»Ÿå¯†ç æ›´å®‰å…¨ã€‚

```
ä¼ ç»Ÿå¯†ç è®¤è¯ï¼š
ç”¨æˆ· â†’ è¾“å…¥å¯†ç  â†’ æœåŠ¡å™¨éªŒè¯ â†’ ç™»å½•æˆåŠŸ
é—®é¢˜ï¼šå¯†ç å¯èƒ½è¢«ç ´è§£ã€æ³„éœ²

SSHå¯†é’¥è®¤è¯ï¼š
ç”¨æˆ· â†’ ä½¿ç”¨ç§é’¥ç­¾å â†’ æœåŠ¡å™¨ç”¨å…¬é’¥éªŒè¯ â†’ ç™»å½•æˆåŠŸ
ä¼˜åŠ¿ï¼šç§é’¥ä¸ä¼ è¾“ï¼Œæžéš¾ç ´è§£
```

### 1.2 å…¬é’¥å¯†ç å­¦åŽŸç†


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥åŠ å¯†ç§é’¥è§£å¯†ï¼Œæˆ–è€…ç§é’¥ç­¾åå…¬é’¥éªŒè¯

```
å¯†é’¥å¯¹å…³ç³»å›¾ï¼š

       ç”Ÿæˆå¯†é’¥å¯¹
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ssh-keygen     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç§é’¥    â”‚   â”‚ å…¬é’¥    â”‚
â”‚ Private â”‚   â”‚ Public  â”‚
â”‚ Key     â”‚   â”‚ Key     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚             â”‚
    â”‚             â–¼
    â”‚         æ”¾åˆ°æœåŠ¡å™¨
    â”‚       ~/.ssh/authorized_keys
    â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â†’ é…å¯¹éªŒè¯èº«ä»½
```

### 1.3 SSHå¯†é’¥çš„ä½œç”¨åŽŸç†


**è®¤è¯è¿‡ç¨‹è¯¦è§£**ï¼š
1. **å®¢æˆ·ç«¯**ï¼šç”¨ç§é’¥å¯¹æŒ‘æˆ˜ä¿¡æ¯è¿›è¡Œç­¾å
2. **æœåŠ¡å™¨**ï¼šç”¨å¯¹åº”å…¬é’¥éªŒè¯ç­¾å
3. **éªŒè¯é€šè¿‡**ï¼šå…è®¸ç™»å½•ï¼Œæ— éœ€è¾“å…¥å¯†ç 

ðŸ’¡ **é€šä¿—æ¯”å–»**ï¼š
- **ç§é’¥**ï¼šä½ çš„èº«ä»½è¯ï¼Œåªæœ‰ä½ æœ‰ï¼Œç»å¯¹ä¿å¯†
- **å…¬é’¥**ï¼šä½ èº«ä»½è¯çš„å¤å°ä»¶ï¼Œå¯ä»¥ç»™ä»»ä½•éœ€è¦éªŒè¯ä½ èº«ä»½çš„äºº
- **è®¤è¯**ï¼šåˆ«äººæ‹¿ä½ çš„èº«ä»½è¯å¤å°ä»¶æ¥éªŒè¯ä½ ç¡®å®žæ˜¯æœ¬äºº

---

## 2. âš™ï¸ å¯†é’¥å¯¹ç”Ÿæˆä¸Žç®¡ç†


### 2.1 ssh-keygenå‘½ä»¤è¯¦è§£


**åŸºæœ¬è¯­æ³•**ï¼š
```bash
ssh-keygen [é€‰é¡¹] [å‚æ•°]
```

**æœ€å¸¸ç”¨çš„ç”Ÿæˆå‘½ä»¤**ï¼š
```bash
# ç”Ÿæˆé»˜è®¤RSAå¯†é’¥ï¼ˆ2048ä½ï¼‰
ssh-keygen

# æŒ‡å®šå¯†é’¥ç±»åž‹å’Œä½æ•°
ssh-keygen -t rsa -b 4096

# æŒ‡å®šæ–‡ä»¶åå’Œæ³¨é‡Š
ssh-keygen -t ed25519 -f ~/.ssh/my_key -C "user@example.com"
```

### 2.2 ç”Ÿæˆè¿‡ç¨‹è¯¦ç»†æ­¥éª¤


**äº¤äº’å¼ç”Ÿæˆè¿‡ç¨‹**ï¼š

```
$ ssh-keygen -t ed25519 -C "your_email@example.com"

ç¬¬1æ­¥ï¼šé€‰æ‹©ä¿å­˜ä½ç½®
Enter file in which to save the key (/home/user/.ssh/id_ed25519): 
â†’ ç›´æŽ¥å›žè½¦ä½¿ç”¨é»˜è®¤è·¯å¾„ï¼Œæˆ–è¾“å…¥è‡ªå®šä¹‰è·¯å¾„

ç¬¬2æ­¥ï¼šè®¾ç½®å¯†ç çŸ­è¯­ï¼ˆå¯é€‰ä½†æŽ¨èï¼‰
Enter passphrase (empty for no passphrase):
â†’ è¾“å…¥å¯†ç çŸ­è¯­ä¿æŠ¤ç§é’¥ï¼Œæˆ–å›žè½¦è·³è¿‡

ç¬¬3æ­¥ï¼šç¡®è®¤å¯†ç çŸ­è¯­
Enter same passphrase again:
â†’ å†æ¬¡è¾“å…¥ç›¸åŒå¯†ç çŸ­è¯­ç¡®è®¤

ç¬¬4æ­¥ï¼šç”Ÿæˆå®Œæˆ
Your identification has been saved in /home/user/.ssh/id_ed25519
Your public key has been saved in /home/user/.ssh/id_ed25519.pub
```

### 2.3 å¯†é’¥ç”Ÿæˆé€‰é¡¹è¯¦è§£


| é€‰é¡¹ | å«ä¹‰ | ç¤ºä¾‹ | è¯´æ˜Ž |
|------|------|------|------|
| `-t` | æŒ‡å®šå¯†é’¥ç±»åž‹ | `-t ed25519` | RSAã€DSAã€ECDSAã€Ed25519 |
| `-b` | æŒ‡å®šå¯†é’¥ä½æ•° | `-b 4096` | ä½æ•°è¶Šå¤§è¶Šå®‰å…¨ï¼Œä½†é€Ÿåº¦è¶Šæ…¢ |
| `-f` | æŒ‡å®šæ–‡ä»¶è·¯å¾„ | `-f ~/.ssh/mykey` | è‡ªå®šä¹‰å¯†é’¥ä¿å­˜ä½ç½® |
| `-C` | æ·»åŠ æ³¨é‡Š | `-C "work@company"` | ä¾¿äºŽè¯†åˆ«å¯†é’¥ç”¨é€” |
| `-N` | è®¾ç½®å¯†ç çŸ­è¯­ | `-N "mypassword"` | éžäº¤äº’æ–¹å¼è®¾ç½®å¯†ç  |
| `-q` | å®‰é™æ¨¡å¼ | `-q` | å‡å°‘è¾“å‡ºä¿¡æ¯ |

**å®žç”¨ç¤ºä¾‹**ï¼š
```bash
# ä¸ºå·¥ä½œç”¨é€”ç”Ÿæˆä¸“ç”¨å¯†é’¥
ssh-keygen -t ed25519 -f ~/.ssh/work_key -C "work@company.com"

# ç”Ÿæˆæ— å¯†ç çŸ­è¯­çš„å¯†é’¥ï¼ˆè‡ªåŠ¨åŒ–åœºæ™¯ï¼‰
ssh-keygen -t rsa -b 4096 -f ~/.ssh/automation_key -N ""

# æ‰¹é‡ç”Ÿæˆï¼ˆè„šæœ¬ä¸­ä½¿ç”¨ï¼‰
ssh-keygen -t ed25519 -f ~/.ssh/backup_key -N "strongpassword" -q
```

---

## 3. ðŸ”‘ å¯†é’¥ç±»åž‹æ·±åº¦è§£æž


### 3.1 å››ç§ä¸»è¦å¯†é’¥ç±»åž‹å¯¹æ¯”


| å¯†é’¥ç±»åž‹ | **å®‰å…¨å¼ºåº¦** | **å¯†é’¥é•¿åº¦** | **ç”Ÿæˆé€Ÿåº¦** | **å…¼å®¹æ€§** | **æŽ¨èç¨‹åº¦** |
|----------|------------|------------|------------|----------|------------|
| ðŸ”´ **RSA** | `ä¸­ç­‰-é«˜` | `2048-4096ä½` | `æ…¢` | `æžå¥½` | `â­â­â­â˜†â˜†` |
| ðŸŸ¡ **DSA** | `ä½Ž` | `1024ä½å›ºå®š` | `å¿«` | `å¥½` | `â­â˜†â˜†â˜†â˜†` |
| ðŸ”µ **ECDSA** | `é«˜` | `256/384/521ä½` | `å¿«` | `è¾ƒå¥½` | `â­â­â­â­â˜†` |
| ðŸŸ¢ **Ed25519** | `æžé«˜` | `256ä½å›ºå®š` | `æžå¿«` | `æ–°ç³»ç»Ÿå¥½` | `â­â­â­â­â­` |

### 3.2 RSAå¯†é’¥è¯¦è§£


**ç‰¹ç‚¹è¯´æ˜Ž**ï¼š
- **ç®—æ³•åŸºç¡€**ï¼šåŸºäºŽå¤§æ•°åˆ†è§£éš¾é¢˜
- **å¯†é’¥é•¿åº¦**ï¼š2048ä½æ˜¯æœ€ä½Žå®‰å…¨æ ‡å‡†ï¼Œ4096ä½æ›´å®‰å…¨
- **å…¼å®¹æ€§**ï¼šå‡ ä¹Žæ‰€æœ‰SSHæœåŠ¡å™¨éƒ½æ”¯æŒ
- **æ€§èƒ½**ï¼šç”Ÿæˆå’Œä½¿ç”¨éƒ½æ¯”è¾ƒæ…¢

**ä½¿ç”¨åœºæ™¯**ï¼š
```bash
# éœ€è¦æœ€å¤§å…¼å®¹æ€§çš„åœºæ™¯
ssh-keygen -t rsa -b 4096 -C "compatibility@example.com"

# æ—§ç³»ç»Ÿæˆ–ä¸¥æ ¼å®‰å…¨è¦æ±‚
ssh-keygen -t rsa -b 4096 -f ~/.ssh/legacy_server
```

âœ… **æŽ¨èä½¿ç”¨**ï¼šéœ€è¦å…¼å®¹æ—§ç³»ç»Ÿæ—¶  
âŒ **ä¸æŽ¨è**ï¼šå¯¹æ€§èƒ½æœ‰è¦æ±‚çš„åœºæ™¯

### 3.3 DSAå¯†é’¥è¯¦è§£


**ç‰¹ç‚¹è¯´æ˜Ž**ï¼š
- **ç®—æ³•åŸºç¡€**ï¼šæ•°å­—ç­¾åç®—æ³•
- **å›ºå®šé•¿åº¦**ï¼šåªèƒ½ç”Ÿæˆ1024ä½å¯†é’¥
- **å®‰å…¨é—®é¢˜**ï¼š1024ä½å¼ºåº¦ä¸è¶³ï¼Œå®¹æ˜“è¢«ç ´è§£
- **çŽ°çŠ¶**ï¼šå·²è¢«å¤§å¤šæ•°ç³»ç»ŸåºŸå¼ƒ

ðŸš¨ **é‡è¦æé†’**ï¼šDSAå¯†é’¥å·²ä¸å®‰å…¨ï¼Œå¼ºçƒˆä¸æŽ¨èä½¿ç”¨ï¼

```bash
# DSAå·²è¿‡æ—¶ï¼Œä»…ä½œäº†è§£
ssh-keygen -t dsa  # ä¸æŽ¨èä½¿ç”¨
```

### 3.4 ECDSAå¯†é’¥è¯¦è§£


**ç‰¹ç‚¹è¯´æ˜Ž**ï¼š
- **ç®—æ³•åŸºç¡€**ï¼šæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•
- **å¯†é’¥é•¿åº¦**ï¼š256ä½å¼ºåº¦ç­‰åŒäºŽRSA 3072ä½
- **æ€§èƒ½**ï¼šç”Ÿæˆå¿«ï¼ŒéªŒè¯å¿«
- **å®‰å…¨æ€§**ï¼šç†è®ºä¸Šå¾ˆå®‰å…¨

**å¯é€‰æ›²çº¿**ï¼š
```bash
# P-256æ›²çº¿ï¼ˆæœ€å¸¸ç”¨ï¼‰
ssh-keygen -t ecdsa -b 256

# P-384æ›²çº¿ï¼ˆæ›´å®‰å…¨ï¼‰
ssh-keygen -t ecdsa -b 384

# P-521æ›²çº¿ï¼ˆæœ€é«˜å®‰å…¨çº§åˆ«ï¼‰
ssh-keygen -t ecdsa -b 521
```

âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šæŸäº›å®žçŽ°å¯èƒ½å­˜åœ¨åŽé—¨æ‹…å¿§

### 3.5 Ed25519å¯†é’¥è¯¦è§£ï¼ˆå¼ºçƒˆæŽ¨èï¼‰


**ç‰¹ç‚¹è¯´æ˜Ž**ï¼š
- **çŽ°ä»£ç®—æ³•**ï¼šåŸºäºŽEdwardsæ›²çº¿25519
- **å›ºå®šé•¿åº¦**ï¼š256ä½ï¼Œæ— éœ€é€‰æ‹©
- **æžé«˜å®‰å…¨æ€§**ï¼šæŠ—é‡å­è®¡ç®—æ”»å‡»èƒ½åŠ›å¼º
- **æžä½³æ€§èƒ½**ï¼šç”Ÿæˆå’ŒéªŒè¯éƒ½éžå¸¸å¿«

**ä¸ºä»€ä¹ˆæŽ¨èEd25519**ï¼š
```
å®‰å…¨æ€§å¯¹æ¯”ï¼š
Ed25519 256ä½ â‰ˆ RSA 4096ä½ â‰ˆ ECDSA 384ä½

æ€§èƒ½å¯¹æ¯”ï¼š
Ed25519ç”Ÿæˆé€Ÿåº¦ï¼šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
RSAç”Ÿæˆé€Ÿåº¦ï¼š     â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  40%
ECDSAç”Ÿæˆé€Ÿåº¦ï¼š   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  80%
```

**ç”ŸæˆEd25519å¯†é’¥**ï¼š
```bash
# æ ‡å‡†ç”Ÿæˆï¼ˆæŽ¨èï¼‰
ssh-keygen -t ed25519 -C "modern@example.com"

# æŒ‡å®šæ–‡ä»¶å
ssh-keygen -t ed25519 -f ~/.ssh/ed25519_main -C "primary key"
```

âœ… **å¼ºçƒˆæŽ¨è**ï¼šæ‰€æœ‰æ–°éƒ¨ç½²çš„ç³»ç»Ÿéƒ½åº”ä½¿ç”¨Ed25519

---

## 4. ðŸ“ å¯†é’¥æ–‡ä»¶æ ¼å¼ä¸Žæƒé™


### 4.1 å¯†é’¥æ–‡ä»¶çš„æ ‡å‡†ä½ç½®


**SSHç›®å½•ç»“æž„**ï¼š
```
~/.ssh/                    â† SSHé…ç½®ç›®å½•
â”œâ”€â”€ id_rsa                 â† RSAç§é’¥
â”œâ”€â”€ id_rsa.pub             â† RSAå…¬é’¥
â”œâ”€â”€ id_ed25519             â† Ed25519ç§é’¥
â”œâ”€â”€ id_ed25519.pub         â† Ed25519å…¬é’¥
â”œâ”€â”€ authorized_keys        â† æŽˆæƒå…¬é’¥åˆ—è¡¨
â”œâ”€â”€ known_hosts            â† å·²çŸ¥ä¸»æœºæŒ‡çº¹
â”œâ”€â”€ config                 â† SSHå®¢æˆ·ç«¯é…ç½®
â””â”€â”€ [å…¶ä»–è‡ªå®šä¹‰å¯†é’¥æ–‡ä»¶]
```

### 4.2 æ–‡ä»¶æƒé™è¯¦è§£


**æƒé™è¦æ±‚è¯´æ˜Ž**ï¼šSSHå¯¹æ–‡ä»¶æƒé™è¦æ±‚éžå¸¸ä¸¥æ ¼ï¼Œæƒé™é”™è¯¯ä¼šå¯¼è‡´è®¤è¯å¤±è´¥ã€‚

| æ–‡ä»¶/ç›®å½• | **æƒé™** | **æ•°å­—è¡¨ç¤º** | **å«ä¹‰** |
|-----------|---------|------------|---------|
| `~/.ssh/` | `drwx------` | `700` | åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™æ‰§è¡Œ |
| **ç§é’¥æ–‡ä»¶** | `-rw-------` | `600` | åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™ |
| **å…¬é’¥æ–‡ä»¶** | `-rw-r--r--` | `644` | æ‰€æœ‰è€…è¯»å†™ï¼Œå…¶ä»–äººåªè¯» |
| `authorized_keys` | `-rw-------` | `600` | åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™ |
| `known_hosts` | `-rw-r--r--` | `644` | æ‰€æœ‰è€…è¯»å†™ï¼Œå…¶ä»–äººåªè¯» |

**è®¾ç½®æ­£ç¡®æƒé™**ï¼š
```bash
# è®¾ç½®SSHç›®å½•æƒé™
chmod 700 ~/.ssh

# è®¾ç½®ç§é’¥æƒé™ï¼ˆé‡è¦ï¼ï¼‰
chmod 600 ~/.ssh/id_*
chmod 600 ~/.ssh/*_rsa
chmod 600 ~/.ssh/*_ed25519

# è®¾ç½®å…¬é’¥æƒé™
chmod 644 ~/.ssh/*.pub

# è®¾ç½®authorized_keysæƒé™
chmod 600 ~/.ssh/authorized_keys
```

âš ï¸ **æƒé™é”™è¯¯å¸¸è§é—®é¢˜**ï¼š
```bash
# æ£€æŸ¥æƒé™é—®é¢˜
ls -la ~/.ssh/

# å¦‚æžœçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æƒé™ï¼ŒSSHä¼šæ‹’ç»è®¤è¯ï¼š
-rw-rw-rw- 1 user user 1679 Jan 17 10:30 id_rsa  # âŒ å¤ªå®½æ¾
-rw-r--r-- 1 user user 1679 Jan 17 10:30 id_rsa  # âŒ å…¶ä»–äººå¯è¯»
```

### 4.3 å¯†é’¥æ–‡ä»¶æ ¼å¼è§£æž


**ç§é’¥æ–‡ä»¶æ ¼å¼**ï¼š
```
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAIEAyKhMlSQSvJE7BUz9EJBrKe8eBwHl0ZpAmYZs4P8TrhEVKR8+uRXx
...
-----END OPENSSH PRIVATE KEY-----
```

**å…¬é’¥æ–‡ä»¶æ ¼å¼**ï¼š
```
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKqP1EH2bADEJ+ZLJBqrUqL3uL4L8xJ7cTmVQl4rBnxL user@hostname

è§£æžï¼š
[å¯†é’¥ç±»åž‹] [å¯†é’¥æ•°æ®] [æ³¨é‡Š]
```

**æ–‡ä»¶å†…å®¹è¯´æ˜Ž**ï¼š
- **ç§é’¥**ï¼šåŒ…å«å®Œæ•´çš„åŠ å¯†ä¿¡æ¯ï¼Œç»å¯¹ä¿å¯†
- **å…¬é’¥**ï¼šå•è¡Œæ–‡æœ¬ï¼Œå¯ä»¥è‡ªç”±åˆ†äº«
- **æ³¨é‡Š**ï¼šé€šå¸¸æ˜¯ç”¨æˆ·å@ä¸»æœºåï¼Œä¾¿äºŽè¯†åˆ«

---

## 5. ðŸ¤– SSHä»£ç†ä¸Žå¯†é’¥ç®¡ç†


### 5.1 ä»€ä¹ˆæ˜¯ssh-agent


**ç®€å•ç†è§£**ï¼šssh-agentæ˜¯ä¸€ä¸ª"å¯†é’¥ç®¡å®¶"ï¼Œå¸®ä½ è®°ä½æ‰€æœ‰å¯†é’¥çš„å¯†ç ï¼Œè¿™æ ·ä½ åªéœ€è¦è¾“å…¥ä¸€æ¬¡å¯†ç çŸ­è¯­ã€‚

```
æ²¡æœ‰ssh-agentï¼š
æ¯æ¬¡SSHè¿žæŽ¥ â†’ è¾“å…¥ç§é’¥å¯†ç  â†’ éªŒè¯ â†’ è¿žæŽ¥æˆåŠŸ
â†‘ æ¯æ¬¡éƒ½è¦è¾“å…¥ï¼Œå¾ˆéº»çƒ¦

ä½¿ç”¨ssh-agentï¼š
å¯åŠ¨æ—¶è¾“å…¥ä¸€æ¬¡å¯†ç  â†’ ssh-agentè®°ä½ â†’ ä»¥åŽè‡ªåŠ¨ä½¿ç”¨
â†‘ åªè¾“å…¥ä¸€æ¬¡ï¼Œè‡ªåŠ¨ç®¡ç†
```

### 5.2 ssh-agentåŸºæœ¬ä½¿ç”¨


**å¯åŠ¨ssh-agent**ï¼š
```bash
# æ–¹æ³•1ï¼šå¯åŠ¨æ–°çš„agent
eval "$(ssh-agent -s)"

# æ–¹æ³•2ï¼šæ£€æŸ¥æ˜¯å¦å·²è¿è¡Œ
echo $SSH_AGENT_PID
echo $SSH_AUTH_SOCK

# æ–¹æ³•3ï¼šåœ¨shellå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨
echo 'eval "$(ssh-agent -s)"' >> ~/.bashrc
```

**æ·»åŠ å¯†é’¥åˆ°agent**ï¼š
```bash
# æ·»åŠ é»˜è®¤å¯†é’¥
ssh-add

# æ·»åŠ æŒ‡å®šå¯†é’¥
ssh-add ~/.ssh/id_ed25519
ssh-add ~/.ssh/work_key

# æ·»åŠ æ—¶æŒ‡å®šå¯†é’¥æœ‰æ•ˆæœŸ
ssh-add -t 3600 ~/.ssh/id_rsa  # 1å°æ—¶åŽè¿‡æœŸ
```

### 5.3 ssh-agentå¸¸ç”¨å‘½ä»¤


| å‘½ä»¤ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| `ssh-add -l` | åˆ—å‡ºå·²åŠ è½½çš„å¯†é’¥ | æŸ¥çœ‹å½“å‰ç®¡ç†çš„å¯†é’¥ |
| `ssh-add -L` | æ˜¾ç¤ºå…¬é’¥å†…å®¹ | èŽ·å–å…¬é’¥ç”¨äºŽå¤åˆ¶ |
| `ssh-add -d` | åˆ é™¤æŒ‡å®šå¯†é’¥ | `ssh-add -d ~/.ssh/id_rsa` |
| `ssh-add -D` | åˆ é™¤æ‰€æœ‰å¯†é’¥ | æ¸…ç©ºagentä¸­çš„å¯†é’¥ |
| `ssh-add -x` | é”å®šagent | éœ€è¦å¯†ç æ‰èƒ½ä½¿ç”¨ |
| `ssh-add -X` | è§£é”agent | è§£é™¤é”å®šçŠ¶æ€ |

**å®žç”¨ç¤ºä¾‹**ï¼š
```bash
# æŸ¥çœ‹å½“å‰åŠ è½½çš„å¯†é’¥
$ ssh-add -l
2048 SHA256:abc...xyz user@hostname (RSA)
256 SHA256:def...uvw user@hostname (ED25519)

# æ˜¾ç¤ºå…¬é’¥ï¼ˆç”¨äºŽå¤åˆ¶åˆ°æœåŠ¡å™¨ï¼‰
$ ssh-add -L
ssh-ed25519 AAAAC3Nz...xyz user@hostname

# æ¸…ç©ºæ‰€æœ‰å¯†é’¥ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
$ ssh-add -D
All identities removed.
```

### 5.4 ssh-agenté«˜çº§åŠŸèƒ½


**å¯†é’¥è½¬å‘**ï¼š
```bash
# SSHè¿žæŽ¥æ—¶å¯ç”¨agentè½¬å‘
ssh -A user@server

# æˆ–åœ¨configä¸­é…ç½®
Host myserver
    ForwardAgent yes
```

**å¤šå¯†é’¥ç®¡ç†ç­–ç•¥**ï¼š
```bash
# ä¸ºä¸åŒç”¨é€”å‡†å¤‡ä¸åŒå¯†é’¥
ssh-add ~/.ssh/work_key      # å·¥ä½œæœåŠ¡å™¨
ssh-add ~/.ssh/personal_key  # ä¸ªäººé¡¹ç›®
ssh-add ~/.ssh/backup_key    # å¤‡ä»½æœåŠ¡å™¨

# æŒ‰éœ€åŠ è½½å¯†é’¥
ssh-add -t 7200 ~/.ssh/temporary_key  # 2å°æ—¶åŽè‡ªåŠ¨ç§»é™¤
```

---

## 6. ðŸ”— å…¬é’¥è®¤è¯é…ç½®


### 6.1 authorized_keysæ–‡ä»¶è¯¦è§£


**ä½œç”¨**ï¼š`authorized_keys`æ–‡ä»¶å­˜å‚¨å…è®¸ç™»å½•çš„å…¬é’¥åˆ—è¡¨ï¼Œæ˜¯SSHå…¬é’¥è®¤è¯çš„æ ¸å¿ƒã€‚

**æ–‡ä»¶ä½ç½®**ï¼š`~/.ssh/authorized_keys`ï¼ˆåœ¨æœåŠ¡å™¨ç«¯ï¼‰

**åŸºæœ¬æ ¼å¼**ï¼š
```bash
# å•ä¸ªå…¬é’¥å ä¸€è¡Œ
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKqP1EH... user1@client1
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC5H... user2@client2

# å¯ä»¥æ·»åŠ æ³¨é‡Šï¼ˆä»¥#å¼€å¤´ï¼‰
# è¿™æ˜¯ç®¡ç†å‘˜çš„å¯†é’¥
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAbc... admin@workstation
```

### 6.2 å…¬é’¥éƒ¨ç½²æ–¹æ³•


**æ–¹æ³•1ï¼šä½¿ç”¨ssh-copy-idï¼ˆæŽ¨èï¼‰**
```bash
# å¤åˆ¶é»˜è®¤å…¬é’¥
ssh-copy-id user@server

# å¤åˆ¶æŒ‡å®šå…¬é’¥
ssh-copy-id -i ~/.ssh/work_key.pub user@server

# æŒ‡å®šç«¯å£
ssh-copy-id -p 2222 user@server
```

**æ–¹æ³•2ï¼šæ‰‹åŠ¨å¤åˆ¶**
```bash
# æ­¥éª¤1ï¼šåœ¨æœ¬åœ°æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_ed25519.pub

# æ­¥éª¤2ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ·»åŠ å…¬é’¥
mkdir -p ~/.ssh
echo "ssh-ed25519 AAAAC3Nz...xyz user@hostname" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

**æ–¹æ³•3ï¼šä½¿ç”¨scpå¤åˆ¶**
```bash
# å°†å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨
scp ~/.ssh/id_ed25519.pub user@server:/tmp/

# åœ¨æœåŠ¡å™¨ä¸Šæ·»åŠ 
cat /tmp/id_ed25519.pub >> ~/.ssh/authorized_keys
rm /tmp/id_ed25519.pub
```

### 6.3 authorized_keysé«˜çº§é…ç½®


**è®¿é—®é™åˆ¶é€‰é¡¹**ï¼š
```bash
# é™åˆ¶æ¥æºIP
from="192.168.1.100" ssh-ed25519 AAAAC3Nz...xyz user@client

# é™åˆ¶å‘½ä»¤æ‰§è¡Œ
command="/bin/backup.sh" ssh-ed25519 AAAAC3Nz...xyz backup@client

# ç¦æ­¢ç«¯å£è½¬å‘
no-port-forwarding ssh-ed25519 AAAAC3Nz...xyz restricted@client

# ç¦æ­¢X11è½¬å‘
no-X11-forwarding ssh-ed25519 AAAAC3Nz...xyz webuser@client

# ç»„åˆå¤šä¸ªé™åˆ¶
from="10.0.0.0/8",command="/usr/bin/rsync",no-port-forwarding ssh-ed25519 AAAAC3Nz...xyz
```

**å®žç”¨é…ç½®ç¤ºä¾‹**ï¼š
```bash
# ç®¡ç†å‘˜å¯†é’¥ï¼ˆå®Œå…¨è®¿é—®ï¼‰
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAdmin... admin@workstation

# å¤‡ä»½ç”¨æˆ·ï¼ˆåªèƒ½æ‰§è¡Œå¤‡ä»½è„šæœ¬ï¼‰
command="/home/user/backup.sh",no-port-forwarding ssh-ed25519 AAAAC3... backup@server

# Webéƒ¨ç½²å¯†é’¥ï¼ˆé™åˆ¶æ¥æºå’Œå‘½ä»¤ï¼‰
from="192.168.100.50",command="/usr/bin/git pull" ssh-ed25519 AAAAC3... deploy@ci-server
```

---

## 7. ðŸ›¡ï¸ å¯†é’¥å®‰å…¨ç­–ç•¥


### 7.1 å¯†é’¥è½®æ¢ç­–ç•¥


**ä¸ºä»€ä¹ˆéœ€è¦è½®æ¢**ï¼š
- **å®‰å…¨éšæ‚£**ï¼šé•¿æœŸä½¿ç”¨åŒä¸€å¯†é’¥å¢žåŠ æ³„éœ²é£Žé™©
- **åˆè§„è¦æ±‚**ï¼šæŸäº›è¡Œä¸šè¦æ±‚å®šæœŸæ›´æ¢å¯†é’¥
- **äººå‘˜å˜åŠ¨**ï¼šå‘˜å·¥ç¦»èŒéœ€è¦æ’¤é”€è®¿é—®æƒé™

**è½®æ¢æ—¶é—´è¡¨**ï¼š
```
å¯†é’¥ç±»åž‹             æŽ¨èè½®æ¢å‘¨æœŸ
ðŸ”´ ç”Ÿäº§çŽ¯å¢ƒå¯†é’¥      æ¯3-6ä¸ªæœˆ
ðŸŸ¡ å¼€å‘çŽ¯å¢ƒå¯†é’¥      æ¯6-12ä¸ªæœˆ
ðŸŸ¢ ä¸ªäººå­¦ä¹ å¯†é’¥      æ¯1-2å¹´
ðŸš¨ æ³„éœ²é£Žé™©å¯†é’¥      ç«‹å³è½®æ¢
```

**è½®æ¢æ“ä½œæ­¥éª¤**ï¼š
```bash
# æ­¥éª¤1ï¼šç”Ÿæˆæ–°å¯†é’¥
ssh-keygen -t ed25519 -f ~/.ssh/new_key -C "rotated-$(date +%Y%m%d)"

# æ­¥éª¤2ï¼šéƒ¨ç½²æ–°å…¬é’¥ï¼ˆä¿ç•™æ—§å¯†é’¥ï¼‰
ssh-copy-id -i ~/.ssh/new_key.pub user@server

# æ­¥éª¤3ï¼šæµ‹è¯•æ–°å¯†é’¥
ssh -i ~/.ssh/new_key user@server

# æ­¥éª¤4ï¼šç§»é™¤æ—§å…¬é’¥
# åœ¨æœåŠ¡å™¨ç«¯ç¼–è¾‘ ~/.ssh/authorized_keys åˆ é™¤æ—§å…¬é’¥

# æ­¥éª¤5ï¼šå®‰å…¨åˆ é™¤æ—§ç§é’¥
shred -vfz -n 3 ~/.ssh/old_key
```

### 7.2 å¯†é’¥æ–‡ä»¶å®‰å…¨å­˜å‚¨


**æœ¬åœ°å­˜å‚¨å®‰å…¨**ï¼š
```bash
# åŠ å¯†æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨
sudo cryptsetup luksFormat /dev/sdX
sudo mount /dev/mapper/encrypted-disk /mnt/secure
cp ~/.ssh/critical_keys* /mnt/secure/

# ä½¿ç”¨å¯†ç çŸ­è¯­ä¿æŠ¤ç§é’¥
ssh-keygen -p -f ~/.ssh/id_ed25519  # æ·»åŠ /ä¿®æ”¹å¯†ç çŸ­è¯­

# å¤‡ä»½åˆ°å®‰å…¨ä½ç½®
tar -czf ssh-keys-backup-$(date +%Y%m%d).tar.gz -C ~/ .ssh/
gpg --symmetric --cipher-algo AES256 ssh-keys-backup-*.tar.gz
```

**æƒé™æŽ§åˆ¶æœ€ä½³å®žè·µ**ï¼š
```bash
# åˆ›å»ºSSHé…ç½®è„šæœ¬
cat > ~/setup-ssh-security.sh << 'EOF'
#!/bin/bash
# ç¡®ä¿SSHç›®å½•å®‰å…¨
chmod 700 ~/.ssh
chmod 600 ~/.ssh/id_*
chmod 600 ~/.ssh/*_rsa
chmod 600 ~/.ssh/*_ed25519
chmod 644 ~/.ssh/*.pub
chmod 600 ~/.ssh/authorized_keys
chmod 600 ~/.ssh/config

echo "SSHæƒé™å·²ä¿®å¤"
EOF

chmod +x ~/setup-ssh-security.sh
```

### 7.3 å¤šçŽ¯å¢ƒå¯†é’¥ç®¡ç†


**çŽ¯å¢ƒéš”ç¦»ç­–ç•¥**ï¼š
```
å¼€å‘çŽ¯å¢ƒï¼š
~/.ssh/dev_ed25519        â† å¼€å‘æœåŠ¡å™¨ä¸“ç”¨
~/.ssh/staging_ed25519    â† æµ‹è¯•çŽ¯å¢ƒä¸“ç”¨

ç”Ÿäº§çŽ¯å¢ƒï¼š
~/.ssh/prod_ed25519       â† ç”Ÿäº§æœåŠ¡å™¨ä¸“ç”¨
~/.ssh/backup_ed25519     â† å¤‡ä»½æœåŠ¡å™¨ä¸“ç”¨

ä¸ªäººé¡¹ç›®ï¼š
~/.ssh/github_ed25519     â† GitHubä¸“ç”¨
~/.ssh/gitlab_ed25519     â† GitLabä¸“ç”¨
```

**SSHé…ç½®æ–‡ä»¶ç®¡ç†**ï¼š
```bash
# ~/.ssh/config ç¤ºä¾‹
Host dev-server
    HostName dev.company.com
    User developer
    IdentityFile ~/.ssh/dev_ed25519
    Port 2222

Host prod-server
    HostName prod.company.com
    User admin
    IdentityFile ~/.ssh/prod_ed25519
    Port 22
    
Host github.com
    User git
    IdentityFile ~/.ssh/github_ed25519
    
Host *.personal
    User myuser
    IdentityFile ~/.ssh/personal_ed25519
```

### 7.4 åº”æ€¥å“åº”é¢„æ¡ˆ


**å¯†é’¥æ³„éœ²åº”æ€¥å¤„ç†**ï¼š
```bash
# 1. ç«‹å³ç¦ç”¨æ³„éœ²çš„å¯†é’¥
# åœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸Šç§»é™¤å¯¹åº”å…¬é’¥
for server in server1 server2 server3; do
    ssh $server "sed -i '/COMPROMISED_KEY_FINGERPRINT/d' ~/.ssh/authorized_keys"
done

# 2. ç”Ÿæˆæ–°å¯†é’¥æ›¿æ¢
ssh-keygen -t ed25519 -f ~/.ssh/emergency_replacement -C "emergency-$(date +%Y%m%d)"

# 3. å¿«é€Ÿéƒ¨ç½²æ–°å¯†é’¥
for server in $(cat server_list.txt); do
    ssh-copy-id -i ~/.ssh/emergency_replacement.pub $server
done

# 4. éªŒè¯æ–°å¯†é’¥å¯ç”¨åŽåˆ é™¤æ—§å¯†é’¥
shred -vfz -n 3 ~/.ssh/compromised_key
```

---

## 8. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ðŸ”¸ SSHå¯†é’¥æœ¬è´¨ï¼šå…¬ç§é’¥å¯¹ï¼Œç§é’¥è¯æ˜Žèº«ä»½ï¼Œå…¬é’¥éªŒè¯èº«ä»½
ðŸ”¸ è®¤è¯åŽŸç†ï¼šç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯ï¼Œæ¯”å¯†ç æ›´å®‰å…¨
ðŸ”¸ å¯†é’¥ç”Ÿæˆï¼šä½¿ç”¨ssh-keygenï¼ŒæŽ¨èEd25519ç±»åž‹
ðŸ”¸ æ–‡ä»¶æƒé™ï¼šSSHç›®å½•700ï¼Œç§é’¥600ï¼Œå…¬é’¥644
ðŸ”¸ ä»£ç†ç®¡ç†ï¼šssh-agentç®¡ç†å¯†é’¥ï¼Œé¿å…é‡å¤è¾“å…¥å¯†ç 
ðŸ”¸ å…¬é’¥éƒ¨ç½²ï¼šauthorized_keysæ–‡ä»¶æŽ§åˆ¶ç™»å½•æƒé™
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ å¯†é’¥ç±»åž‹é€‰æ‹©åŽŸåˆ™**ï¼š
```
æ–°éƒ¨ç½²ç³»ç»Ÿï¼šä¼˜å…ˆé€‰æ‹©Ed25519
å…¼å®¹è€ç³»ç»Ÿï¼šä½¿ç”¨RSA 4096ä½
é¿å…ä½¿ç”¨ï¼šDSAï¼ˆä¸å®‰å…¨ï¼‰
è°¨æ…Žä½¿ç”¨ï¼šECDSAï¼ˆå¯èƒ½æœ‰åŽé—¨ï¼‰
```

**ðŸ”¹ å®‰å…¨æœ€ä½³å®žè·µ**ï¼š
```
æƒé™æŽ§åˆ¶ï¼šä¸¥æ ¼çš„æ–‡ä»¶æƒé™è®¾ç½®
å¯†ç çŸ­è¯­ï¼šä¸ºç§é’¥æ·»åŠ å¯†ç ä¿æŠ¤  
å®šæœŸè½®æ¢ï¼šæ ¹æ®é£Žé™©ç­‰çº§å®šæœŸæ›´æ¢
çŽ¯å¢ƒéš”ç¦»ï¼šä¸åŒçŽ¯å¢ƒä½¿ç”¨ä¸åŒå¯†é’¥
å¤‡ä»½ç­–ç•¥ï¼šåŠ å¯†å¤‡ä»½é‡è¦å¯†é’¥
```

**ðŸ”¹ å¸¸è§é—®é¢˜è§£å†³**ï¼š
```
æƒé™é”™è¯¯ï¼šchmod 700 ~/.ssh && chmod 600 ~/.ssh/id_*
Agenté—®é¢˜ï¼ševal "$(ssh-agent -s)" && ssh-add
è¿žæŽ¥å¤±è´¥ï¼šæ£€æŸ¥å…¬é’¥æ˜¯å¦æ­£ç¡®éƒ¨ç½²åˆ°authorized_keys
```

### 8.3 å®žé™…åº”ç”¨ä»·å€¼


**ðŸŽ¯ æ—¥å¸¸å·¥ä½œåœºæ™¯**ï¼š
- **æœåŠ¡å™¨ç®¡ç†**ï¼šæ— å¯†ç ç™»å½•å¤šå°æœåŠ¡å™¨
- **ä»£ç æ‰˜ç®¡**ï¼šGitä»“åº“çš„å®‰å…¨è®¿é—®
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šCI/CDæµç¨‹ä¸­çš„èº«ä»½è®¤è¯
- **æ–‡ä»¶ä¼ è¾“**ï¼šscp/rsyncçš„å®‰å…¨ä¼ è¾“

**ðŸ”§ è¿ç»´å®žè·µ**ï¼š
- **æ‰¹é‡ç®¡ç†**ï¼šä¸€é”®éƒ¨ç½²å…¬é’¥åˆ°å¤šå°æœåŠ¡å™¨
- **æƒé™æŽ§åˆ¶**ï¼šåŸºäºŽå¯†é’¥çš„ç²¾ç»†åŒ–è®¿é—®æŽ§åˆ¶
- **å®‰å…¨å®¡è®¡**ï¼šè¿½è¸ªå¯†é’¥ä½¿ç”¨å’Œè®¿é—®è®°å½•
- **æ•…éšœæ¢å¤**ï¼šå¯†é’¥ç®¡ç†çš„åº”æ€¥å“åº”é¢„æ¡ˆ

### 8.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ðŸ“š åŸºç¡€æŽŒæ¡**ï¼š
1. ç†è§£å…¬é’¥å¯†ç å­¦åŸºæœ¬åŽŸç†
2. ç†Ÿç»ƒä½¿ç”¨ssh-keygenç”Ÿæˆå¯†é’¥
3. æŽŒæ¡æ–‡ä»¶æƒé™è®¾ç½®å’Œæ•…éšœæŽ’é™¤
4. å­¦ä¼šä½¿ç”¨ssh-agentç®€åŒ–å¯†é’¥ç®¡ç†

**ðŸš€ è¿›é˜¶åº”ç”¨**ï¼š
1. å¤šçŽ¯å¢ƒå¯†é’¥ç®¡ç†å’ŒSSHé…ç½®
2. authorized_keysçš„é«˜çº§é€‰é¡¹é…ç½®
3. å¯†é’¥è½®æ¢å’Œå®‰å…¨ç­–ç•¥åˆ¶å®š
4. è‡ªåŠ¨åŒ–è„šæœ¬å’Œæ‰¹é‡ç®¡ç†å·¥å…·

**ðŸŽ“ å®žè·µé¡¹ç›®**ï¼š
- æ­å»ºä¸ªäººæœåŠ¡å™¨å¹¶é…ç½®å¯†é’¥è®¤è¯
- ä¸ºå›¢é˜Ÿåˆ¶å®šSSHå¯†é’¥ç®¡ç†è§„èŒƒ
- ç¼–å†™å¯†é’¥éƒ¨ç½²å’Œè½®æ¢è„šæœ¬
- é›†æˆSSHå¯†é’¥åˆ°CI/CDæµç¨‹

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- SSHå¯†é’¥æ¯”å¯†ç æ›´å®‰å…¨æ›´æ–¹ä¾¿
- Ed25519æ˜¯çŽ°ä»£æœ€ä½³é€‰æ‹©
- ä¸¥æ ¼çš„æ–‡ä»¶æƒé™æ˜¯å®‰å…¨åŸºç¡€  
- ssh-agentè®©å¯†é’¥ç®¡ç†æ›´è½»æ¾
- å®šæœŸè½®æ¢å’Œå¤‡ä»½æ˜¯å®‰å…¨å¿…éœ€