---
title: 8ã€DNSå®‰å…¨é…ç½®ä¸è®¿é—®æ§åˆ¶
---
## ğŸ“š ç›®å½•


1. [DNSå®‰å…¨åŸºç¡€æ¦‚å¿µ](#1-DNSå®‰å…¨åŸºç¡€æ¦‚å¿µ)
2. [ACLè®¿é—®æ§åˆ¶åˆ—è¡¨é…ç½®](#2-ACLè®¿é—®æ§åˆ¶åˆ—è¡¨é…ç½®)
3. [æŸ¥è¯¢æƒé™æ§åˆ¶æœºåˆ¶](#3-æŸ¥è¯¢æƒé™æ§åˆ¶æœºåˆ¶)
4. [åŒºåŸŸä¼ è¾“æ§åˆ¶é…ç½®](#4-åŒºåŸŸä¼ è¾“æ§åˆ¶é…ç½®)
5. [åŠ¨æ€æ›´æ–°æƒé™ç®¡ç†](#5-åŠ¨æ€æ›´æ–°æƒé™ç®¡ç†)
6. [é€Ÿç‡é™åˆ¶ä¸é˜²æŠ¤](#6-é€Ÿç‡é™åˆ¶ä¸é˜²æŠ¤)
7. [é»‘æ´é…ç½®ä¸IPå±è”½](#7-é»‘æ´é…ç½®ä¸IPå±è”½)
8. [DNSæ¬ºéª—é˜²æŠ¤æœºåˆ¶](#8-DNSæ¬ºéª—é˜²æŠ¤æœºåˆ¶)
9. [chrootç¯å¢ƒå®‰å…¨åŠ å›º](#9-chrootç¯å¢ƒå®‰å…¨åŠ å›º)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šDNSåŸºç¡€åŸç†ã€BINDæœåŠ¡å™¨é…ç½® â†’ **å½“å‰å†…å®¹**ï¼šDNSå®‰å…¨é…ç½®ä¸è®¿é—®æ§åˆ¶ â†’ **åç»­å­¦ä¹ **ï¼šDNSç›‘æ§ä¸æ•…éšœæ’é™¤

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡90åˆ†é’Ÿ | å®è·µé…ç½®60åˆ†é’Ÿ

ğŸ·ï¸ **çŸ¥è¯†æ ‡ç­¾**ï¼š`#DNSå®‰å…¨` `#è®¿é—®æ§åˆ¶` `#ç½‘ç»œé˜²æŠ¤` `#ç³»ç»ŸåŠ å›º`

---

## 1. ğŸ›¡ï¸ DNSå®‰å…¨åŸºç¡€æ¦‚å¿µ



### 1.1 DNSå®‰å…¨å¨èƒæ¦‚è¿°



**ğŸ”¸ æ ¸å¿ƒå®‰å…¨å¨èƒ**
```
DNSç¼“å­˜æŠ•æ¯’ï¼šæ¶æ„ç¯¡æ”¹DNSå“åº”ï¼Œé‡å®šå‘æµé‡
DNSæ”¾å¤§æ”»å‡»ï¼šåˆ©ç”¨DNSæŸ¥è¯¢è¿›è¡ŒDDoSæ”»å‡»
åŒºåŸŸä¼ è¾“æ³„éœ²ï¼šæœªæˆæƒè·å–å®Œæ•´åŸŸåä¿¡æ¯
DNSéš§é“ï¼šé€šè¿‡DNSåè®®ä¼ è¾“æ¶æ„æ•°æ®
æš´åŠ›ç ´è§£ï¼šæšä¸¾å­åŸŸåå’Œä¸»æœºä¿¡æ¯
```

**ğŸ’¡ é€šä¿—ç†è§£**
DNSå°±åƒäº’è”ç½‘çš„"ç”µè¯ç°¿"ï¼Œå¦‚æœè¿™ä¸ªç”µè¯ç°¿è¢«äººæ¶æ„ä¿®æ”¹ï¼š
- **ç¼“å­˜æŠ•æ¯’**ï¼šæŠŠé“¶è¡Œç½‘ç«™çš„"ç”µè¯å·ç "æ”¹æˆéª—å­çš„
- **æ”¾å¤§æ”»å‡»**ï¼šè®©ç”µè¯ç°¿ä¸æ–­ç»™åˆ«äººæ‰“éªšæ‰°ç”µè¯
- **ä¿¡æ¯æ³„éœ²**ï¼šå·çœ‹æ•´æœ¬ç”µè¯ç°¿è·å–æ‰€æœ‰è”ç³»æ–¹å¼

### 1.2 DNSå®‰å…¨é˜²æŠ¤ä½“ç³»



**ğŸ—ï¸ å®‰å…¨é˜²æŠ¤æ¶æ„**
```
ç½‘ç»œå±‚é˜²æŠ¤ï¼š
â”œâ”€â”€ ACLè®¿é—®æ§åˆ¶ â†’ æ§åˆ¶è°èƒ½è®¿é—®DNSæœåŠ¡
â”œâ”€â”€ æŸ¥è¯¢æƒé™ç®¡ç† â†’ é™åˆ¶æŸ¥è¯¢ç±»å‹å’ŒèŒƒå›´
â”œâ”€â”€ ä¼ è¾“æ§åˆ¶ â†’ ä¿æŠ¤åŒºåŸŸæ•°æ®ä¸è¢«æ³„éœ²
â””â”€â”€ é€Ÿç‡é™åˆ¶ â†’ é˜²æ­¢æ¶æ„å¤§é‡æŸ¥è¯¢

åº”ç”¨å±‚é˜²æŠ¤ï¼š
â”œâ”€â”€ å“åº”éªŒè¯ â†’ æ£€æŸ¥DNSå“åº”åˆæ³•æ€§
â”œâ”€â”€ ç¼“å­˜ä¿æŠ¤ â†’ é˜²æ­¢ç¼“å­˜è¢«æ±¡æŸ“
â”œâ”€â”€ æ—¥å¿—ç›‘æ§ â†’ è®°å½•å¼‚å¸¸è®¿é—®è¡Œä¸º
â””â”€â”€ å®šæœŸæ›´æ–° â†’ åŠæ—¶ä¿®å¤å®‰å…¨æ¼æ´

ç³»ç»Ÿå±‚é˜²æŠ¤ï¼š
â”œâ”€â”€ chrootéš”ç¦» â†’ é™åˆ¶æœåŠ¡è¿è¡Œç¯å¢ƒ
â”œâ”€â”€ ç”¨æˆ·æƒé™ â†’ ä½¿ç”¨éç‰¹æƒç”¨æˆ·è¿è¡Œ
â”œâ”€â”€ æ–‡ä»¶æƒé™ â†’ ä¸¥æ ¼æ§åˆ¶é…ç½®æ–‡ä»¶è®¿é—®
â””â”€â”€ è¿›ç¨‹ç›‘æ§ â†’ å®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€
```

### 1.3 å¸¸è§æ”»å‡»åœºæ™¯



| **æ”»å‡»ç±»å‹** | **æ”»å‡»æ‰‹æ®µ** | **å±å®³ç¨‹åº¦** | **é˜²æŠ¤éš¾åº¦** |
|-------------|-------------|-------------|-------------|
| **ç¼“å­˜æŠ•æ¯’** | ä¼ªé€ DNSå“åº” | â­â­â­â­â­ | â­â­â­â­ |
| **DDoSæ”¾å¤§** | å¤§é‡æŸ¥è¯¢è¯·æ±‚ | â­â­â­â­ | â­â­â­ |
| **åŒºåŸŸä¼ è¾“çªƒå–** | æœªæˆæƒAXFRè¯·æ±‚ | â­â­â­ | â­â­ |
| **å­åŸŸæšä¸¾** | æš´åŠ›ç ´è§£åŸŸå | â­â­ | â­â­ |

---

## 2. ğŸ“‹ ACLè®¿é—®æ§åˆ¶åˆ—è¡¨é…ç½®



### 2.1 ACLåŸºæœ¬æ¦‚å¿µ



**ğŸ”¸ ä»€ä¹ˆæ˜¯ACL**
```
ACL (Access Control List)ï¼šè®¿é—®æ§åˆ¶åˆ—è¡¨
ä½œç”¨ï¼šå®šä¹‰å“ªäº›IPåœ°å€æˆ–ç½‘ç»œå¯ä»¥è®¿é—®DNSæœåŠ¡
åŸç†ï¼šåœ¨é…ç½®ä¸­é¢„å®šä¹‰IPåœ°å€ç»„ï¼Œç„¶ååœ¨å„ä¸ªé…ç½®æ®µå¼•ç”¨
å¥½å¤„ï¼šç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤å’Œä¿®æ”¹
```

**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
ACLå°±åƒå…¬å¸çš„"è®¿å®¢åå•"ï¼š
- **å†…éƒ¨å‘˜å·¥**ï¼šå¯ä»¥è®¿é—®æ‰€æœ‰åŒºåŸŸ
- **åˆä½œä¼™ä¼´**ï¼šåªèƒ½è®¿é—®æŒ‡å®šä¼šè®®å®¤
- **è®¿å®¢**ï¼šåªèƒ½åœ¨å¤§å…ç­‰å€™
- **é»‘åå•**ï¼šç›´æ¥æ‹’ç»å…¥å†…

### 2.2 ACLé…ç½®è¯­æ³•



**ğŸ“ åŸºç¡€ACLå®šä¹‰**
```nginx
# /etc/bind/named.conf.local

acl "internal_networks" {
    192.168.1.0/24;      # å†…ç½‘æ®µ1
    192.168.2.0/24;      # å†…ç½‘æ®µ2
    10.0.0.0/8;          # ç§æœ‰ç½‘ç»œ
    127.0.0.1;           # æœ¬æœº
};

acl "trusted_servers" {
    203.0.113.10;        # DNSè¾…åŠ©æœåŠ¡å™¨
    203.0.113.11;        # ç›‘æ§æœåŠ¡å™¨
    !203.0.113.99;       # æ’é™¤ç‰¹å®šIPï¼ˆæ„Ÿå¹å·è¡¨ç¤ºæ’é™¤ï¼‰
};

acl "blacklist" {
    192.0.2.0/24;        # å·²çŸ¥æ¶æ„ç½‘æ®µ
    198.51.100.50;       # æ”»å‡»è€…IP
};
```

### 2.3 é¢„å®šä¹‰ACL



**ğŸ”§ BINDå†…ç½®ACL**
```
anyï¼šåŒ¹é…æ‰€æœ‰åœ°å€
noneï¼šä¸åŒ¹é…ä»»ä½•åœ°å€
localhostï¼šåŒ¹é…æœ¬æœºæ‰€æœ‰æ¥å£IP
localnetsï¼šåŒ¹é…æœ¬æœºç›´è¿ç½‘ç»œæ®µ
```

**ğŸ“Š ACLä½¿ç”¨ç¤ºä¾‹**
```nginx
# å¤åˆACLå®šä¹‰

acl "dns_clients" {
    internal_networks;    # å¼•ç”¨å·²å®šä¹‰çš„ACL
    trusted_servers;      # å¼•ç”¨å·²å®šä¹‰çš„ACL
    !blacklist;          # æ’é™¤é»‘åå•
};

# å®é™…åº”ç”¨

options {
    allow-query { dns_clients; };
    allow-recursion { internal_networks; };
    blackhole { blacklist; };
};
```

### 2.4 åŠ¨æ€ACLç®¡ç†



**ğŸ”„ ACLæ›´æ–°ç­–ç•¥**
```bash
# åˆ›å»ºACLç®¡ç†è„šæœ¬

#!/bin/bash

# /etc/bind/scripts/update_acl.sh


ACL_FILE="/etc/bind/acl.conf"
BACKUP_DIR="/etc/bind/backup"

update_blacklist() {
    echo "ğŸ”„ æ›´æ–°é»‘åå•ACL..."
    
#    # å¤‡ä»½å½“å‰é…ç½®
    cp "$ACL_FILE" "$BACKUP_DIR/acl_$(date +%Y%m%d_%H%M%S).conf"
    
#    # ä»å¨èƒæƒ…æŠ¥æºä¸‹è½½æœ€æ–°é»‘åå•
    curl -s "https://feeds.example.com/ip_blacklist.txt" | \
    while read -r ip; do
        if [[ "$ip" =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            echo "    $ip;" >> /tmp/new_blacklist.txt
        fi
    done
    
#    # æ›´æ–°ACLé…ç½®
    sed -i '/acl "blacklist"/,/};/{//!d}' "$ACL_FILE"
    sed -i '/acl "blacklist" {/r /tmp/new_blacklist.txt' "$ACL_FILE"
    
#    # é‡æ–°åŠ è½½é…ç½®
    if named-checkconf; then
        systemctl reload bind9
        echo "âœ… ACLæ›´æ–°æˆåŠŸ"
    else
        echo "âŒ é…ç½®é”™è¯¯ï¼Œæ¢å¤å¤‡ä»½"
        cp "$BACKUP_DIR/acl_$(date +%Y%m%d)*.conf" "$ACL_FILE"
    fi
}
```

---

## 3. ğŸ” æŸ¥è¯¢æƒé™æ§åˆ¶æœºåˆ¶



### 3.1 allow-queryé…ç½®è¯¦è§£



**ğŸ”¸ æŸ¥è¯¢æƒé™æ§åˆ¶**
```
allow-queryï¼šæ§åˆ¶è°å¯ä»¥å‘DNSæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚
ä½œç”¨èŒƒå›´ï¼šå¯ä»¥åœ¨optionsã€viewã€zoneçº§åˆ«é…ç½®
é»˜è®¤å€¼ï¼šanyï¼ˆå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯æŸ¥è¯¢ï¼‰
å®‰å…¨å»ºè®®ï¼šé™åˆ¶ä¸ºå¿…è¦çš„å®¢æˆ·ç«¯ç½‘ç»œ
```

**âš™ï¸ é…ç½®å±‚æ¬¡ç»“æ„**
```nginx
# å…¨å±€é»˜è®¤è®¾ç½®

options {
    allow-query { internal_networks; };  # å…¨å±€æŸ¥è¯¢é™åˆ¶
};

# è§†å›¾çº§åˆ«è®¾ç½®

view "internal" {
    match-clients { internal_networks; };
    allow-query { any; };               # å†…ç½‘è§†å›¾å…è®¸æ‰€æœ‰æŸ¥è¯¢
    
    zone "example.com" {
        type master;
        file "/etc/bind/zones/example.com.zone";
        allow-query { internal_networks; };  # åŒºåŸŸçº§åˆ«é™åˆ¶
    };
};

view "external" {
    match-clients { any; };
    allow-query { any; };
    
    zone "example.com" {
        type master;
        file "/etc/bind/zones/example.com.external.zone";
        allow-query { any; };           # å¤–ç½‘åŒºåŸŸå…è®¸å…¬å¼€æŸ¥è¯¢
    };
};
```

### 3.2 é€’å½’æŸ¥è¯¢æ§åˆ¶



**ğŸ”„ allow-recursioné…ç½®**
```nginx
options {
#    # é€’å½’æŸ¥è¯¢æƒé™ï¼ˆæœ€é‡è¦çš„å®‰å…¨é…ç½®ä¹‹ä¸€ï¼‰
    allow-recursion { 
        internal_networks;    # åªå…è®¸å†…ç½‘è¿›è¡Œé€’å½’æŸ¥è¯¢
        localhost;           # å…è®¸æœ¬æœºé€’å½’æŸ¥è¯¢
    };
    
#    # ç¼“å­˜æŸ¥è¯¢æƒé™
    allow-query-cache { 
        internal_networks;    # åªå…è®¸å†…ç½‘æŸ¥è¯¢ç¼“å­˜
    };
    
#    # é€’å½’æŸ¥è¯¢å¼€å…³
    recursion yes;           # å¯ç”¨é€’å½’æŸ¥è¯¢åŠŸèƒ½
};
```

**âš ï¸ å®‰å…¨è¦ç‚¹**
> **å…³é”®ç†è§£**ï¼šé€’å½’æŸ¥è¯¢æ˜¯æœ€å±é™©çš„é…ç½®é¡¹
> - å¦‚æœè®¾ç½®ä¸º`any`ï¼ŒæœåŠ¡å™¨å¯èƒ½è¢«ç”¨äºDDoSæ”»å‡»
> - æ”»å‡»è€…åˆ©ç”¨å¼€æ”¾çš„é€’å½’æœåŠ¡å™¨è¿›è¡ŒDNSæ”¾å¤§æ”»å‡»
> - **å¿…é¡»**é™åˆ¶é€’å½’æŸ¥è¯¢æƒé™åˆ°å¯ä¿¡ç½‘ç»œ

### 3.3 æŸ¥è¯¢ç±»å‹é™åˆ¶



**ğŸ“‹ æŸ¥è¯¢ç±»å‹æ§åˆ¶ç­–ç•¥**
```nginx
# é™åˆ¶ç‰¹å®šæŸ¥è¯¢ç±»å‹

view "restricted" {
    match-clients { external_networks; };
    
#    # åªå…è®¸Aå’ŒAAAAè®°å½•æŸ¥è¯¢
    allow-query { any; };
    
    zone "example.com" {
        type master;
        file "/etc/bind/zones/example.com.restricted.zone";
        
#        # é€šè¿‡zoneæ–‡ä»¶æ§åˆ¶è¿”å›çš„è®°å½•ç±»å‹
#        # ä¸åŒ…å«æ•æ„Ÿçš„TXTã€MXç­‰è®°å½•
    };
};
```

---

## 4. ğŸ”„ åŒºåŸŸä¼ è¾“æ§åˆ¶é…ç½®



### 4.1 åŒºåŸŸä¼ è¾“å®‰å…¨é£é™©



**âš ï¸ åŒºåŸŸä¼ è¾“æ³„éœ²é£é™©**
```
AXFR (å®Œæ•´åŒºåŸŸä¼ è¾“)ï¼šä¼ è¾“æ•´ä¸ªDNSåŒºåŸŸæ•°æ®
IXFR (å¢é‡åŒºåŸŸä¼ è¾“)ï¼šåªä¼ è¾“å˜æ›´éƒ¨åˆ†
å®‰å…¨é£é™©ï¼šæœªæˆæƒçš„åŒºåŸŸä¼ è¾“ä¼šæ³„éœ²æ‰€æœ‰åŸŸåä¿¡æ¯
æ”»å‡»ä»·å€¼ï¼šè·å–å®Œæ•´çš„å†…ç½‘ä¸»æœºæ¸…å•å’Œç½‘ç»œæ‹“æ‰‘
```

**ğŸ” æ³„éœ²ä¿¡æ¯ç¤ºä¾‹**
å¦‚æœæ”»å‡»è€…è·å¾—å®Œæ•´åŒºåŸŸæ•°æ®ï¼Œå¯èƒ½æ³„éœ²ï¼š
- æ‰€æœ‰å­åŸŸåå’Œä¸»æœºå
- å†…ç½‘IPåœ°å€åˆ†é…
- é‚®ä»¶æœåŠ¡å™¨é…ç½®
- ç½‘ç»œæ¶æ„ä¿¡æ¯

### 4.2 allow-transferé…ç½®



**ğŸ”’ ä¼ è¾“æƒé™ä¸¥æ ¼æ§åˆ¶**
```nginx
# å…¨å±€ä¼ è¾“æ§åˆ¶

options {
#    # é»˜è®¤ç¦æ­¢æ‰€æœ‰åŒºåŸŸä¼ è¾“
    allow-transfer { none; };
};

# ä¸»DNSæœåŠ¡å™¨é…ç½®

zone "example.com" {
    type master;
    file "/etc/bind/zones/example.com.zone";
    
#    # åªå…è®¸æŒ‡å®šçš„è¾…åŠ©æœåŠ¡å™¨è¿›è¡ŒåŒºåŸŸä¼ è¾“
    allow-transfer { 
        203.0.113.10;    # è¾…åŠ©DNSæœåŠ¡å™¨1
        203.0.113.11;    # è¾…åŠ©DNSæœåŠ¡å™¨2
    };
    
#    # ä¼ è¾“é€šçŸ¥è®¾ç½®
    notify yes;
    also-notify { 
        203.0.113.10;    # ä¸»åŠ¨é€šçŸ¥è¾…åŠ©æœåŠ¡å™¨æ›´æ–°
        203.0.113.11;
    };
};

# è¾…åŠ©DNSæœåŠ¡å™¨é…ç½®

zone "example.com" {
    type slave;
    file "/var/cache/bind/example.com.zone";
    masters { 203.0.113.5; };  # ä¸»æœåŠ¡å™¨IP
    
#    # è¾…åŠ©æœåŠ¡å™¨ä¹Ÿè¦é™åˆ¶ä¼ è¾“æƒé™
    allow-transfer { none; };   # è¾…åŠ©æœåŠ¡å™¨é€šå¸¸ä¸å…è®¸ä¼ è¾“
};
```

### 4.3 ä¼ è¾“åŠ å¯†ä¸è®¤è¯



**ğŸ” TSIGå¯†é’¥è®¤è¯**
```nginx
# ç”ŸæˆTSIGå¯†é’¥

# dnssec-keygen -a HMAC-MD5 -b 128 -n HOST transfer-key


key "transfer-key" {
    algorithm hmac-md5;
    secret "base64-encoded-key-here==";
};

# ä¸»æœåŠ¡å™¨é…ç½®

zone "example.com" {
    type master;
    file "/etc/bind/zones/example.com.zone";
    
#    # ä½¿ç”¨å¯†é’¥è®¤è¯çš„ä¼ è¾“æ§åˆ¶
    allow-transfer { 
        key transfer-key;
    };
};

# è¾…åŠ©æœåŠ¡å™¨é…ç½®  

server 203.0.113.5 {
    keys { transfer-key; };
};

zone "example.com" {
    type slave;
    masters { 203.0.113.5 key transfer-key; };
    file "/var/cache/bind/example.com.zone";
};
```

---

## 5. ğŸ”§ åŠ¨æ€æ›´æ–°æƒé™ç®¡ç†



### 5.1 åŠ¨æ€æ›´æ–°æœºåˆ¶



**ğŸ”¸ DNSåŠ¨æ€æ›´æ–°æ¦‚å¿µ**
```
Dynamic Updateï¼šå…è®¸å®¢æˆ·ç«¯åŠ¨æ€ä¿®æ”¹DNSè®°å½•
åº”ç”¨åœºæ™¯ï¼šDHCPè‡ªåŠ¨æ³¨å†Œã€åŠ¨æ€IPæ›´æ–°
å®‰å…¨æŒ‘æˆ˜ï¼šæ¶æ„å®¢æˆ·ç«¯å¯èƒ½ç¯¡æ”¹DNSè®°å½•
æ§åˆ¶æœºåˆ¶ï¼šallow-updateæƒé™æ§åˆ¶
```

### 5.2 allow-updateé…ç½®



**âš™ï¸ åŠ¨æ€æ›´æ–°æƒé™æ§åˆ¶**
```nginx
# å®Œå…¨ç¦ç”¨åŠ¨æ€æ›´æ–°ï¼ˆæœ€å®‰å…¨ï¼‰

zone "example.com" {
    type master;
    file "/etc/bind/zones/example.com.zone";
    allow-update { none; };
};

# åŸºäºIPåœ°å€çš„æ›´æ–°æƒé™

zone "dynamic.example.com" {
    type master;
    file "/etc/bind/zones/dynamic.example.com.zone";
    
#    # åªå…è®¸DHCPæœåŠ¡å™¨æ›´æ–°
    allow-update { 
        192.168.1.10;    # DHCPæœåŠ¡å™¨IP
    };
};

# åŸºäºTSIGå¯†é’¥çš„æ›´æ–°æƒé™ï¼ˆæ¨èï¼‰

key "dhcp-update-key" {
    algorithm hmac-md5;
    secret "dhcp-key-secret-here==";
};

zone "auto.example.com" {
    type master;
    file "/etc/bind/zones/auto.example.com.zone";
    
#    # ä½¿ç”¨å¯†é’¥è®¤è¯çš„åŠ¨æ€æ›´æ–°
    allow-update { 
        key dhcp-update-key;
    };
    
#    # æ›´æ–°ç­–ç•¥ï¼ˆå¯é€‰ï¼‰
    update-policy {
        grant dhcp-update-key wildcard *.auto.example.com A AAAA PTR;
    };
};
```

### 5.3 æ›´æ–°ç­–ç•¥ç²¾ç»†æ§åˆ¶



**ğŸ“‹ update-policyè¯¦ç»†é…ç½®**
```nginx
# ç²¾ç»†çš„æ›´æ–°ç­–ç•¥æ§åˆ¶

zone "managed.example.com" {
    type master;
    file "/etc/bind/zones/managed.example.com.zone";
    
    update-policy {
#        # å…è®¸DHCPæœåŠ¡å™¨æ›´æ–°Aè®°å½•
        grant dhcp-key wildcard *.dhcp.managed.example.com A;
        
#        # å…è®¸é‚®ä»¶æœåŠ¡å™¨æ›´æ–°MXè®°å½•  
        grant mail-key name mail.managed.example.com MX;
        
#        # å…è®¸ç®¡ç†å‘˜æ›´æ–°æ‰€æœ‰è®°å½•
        grant admin-key wildcard *.managed.example.com ANY;
        
#        # æ‹’ç»ç‰¹å®šä¸»æœºæ›´æ–°
        deny untrusted-key wildcard *.secure.managed.example.com;
    };
};
```

---

## 6. âš¡ é€Ÿç‡é™åˆ¶ä¸é˜²æŠ¤



### 6.1 rate-limité…ç½®



**ğŸš¦ æŸ¥è¯¢é€Ÿç‡é™åˆ¶**
```nginx
options {
#    # å¯ç”¨é€Ÿç‡é™åˆ¶ï¼ˆBIND 9.10+ï¼‰
    rate-limit {
        responses-per-second 10;     # æ¯ç§’æœ€å¤š10ä¸ªå“åº”
        window 5;                    # æ—¶é—´çª—å£5ç§’
        slip 2;                      # æ¯2ä¸ªè¶…é™å“åº”å‘é€1ä¸ªTCå“åº”
        
#        # é’ˆå¯¹ä¸åŒè®°å½•ç±»å‹çš„é™åˆ¶
        qps-scale 250;               # QPSç¼©æ”¾å› å­
        ipv4-prefix-length 24;       # IPv4ç½‘æ®µé•¿åº¦
        ipv6-prefix-length 56;       # IPv6ç½‘æ®µé•¿åº¦
        
#        # é”™è¯¯å“åº”é™åˆ¶
        errors-per-second 5;         # é”™è¯¯å“åº”é™åˆ¶
        nxdomains-per-second 5;      # NXDOMAINå“åº”é™åˆ¶
    };
    
#    # å¯¹æ‰€æœ‰å®¢æˆ·ç«¯çš„å…¨å±€é™åˆ¶
    clients-per-query 10;            # æ¯ä¸ªæŸ¥è¯¢æœ€å¤š10ä¸ªå®¢æˆ·ç«¯
    max-clients-per-query 100;       # ç¡¬é™åˆ¶100ä¸ªå®¢æˆ·ç«¯
};
```

### 6.2 è¿æ¥é™åˆ¶é…ç½®



**ğŸ”— TCPè¿æ¥æ§åˆ¶**
```nginx
options {
#    # TCPè¿æ¥é™åˆ¶
    tcp-clients 100;                 # æœ€å¤§TCPè¿æ¥æ•°
    tcp-listen-queue 5;              # TCPç›‘å¬é˜Ÿåˆ—é•¿åº¦
    
#    # æŸ¥è¯¢è¶…æ—¶è®¾ç½®
    resolver-query-timeout 10;       # é€’å½’æŸ¥è¯¢è¶…æ—¶
    max-cache-ttl 86400;            # æœ€å¤§ç¼“å­˜TTL
    max-ncache-ttl 3600;            # æœ€å¤§è´Ÿç¼“å­˜TTL
    
#    # å¹¶å‘æŸ¥è¯¢é™åˆ¶
    recursive-clients 1000;          # æœ€å¤§é€’å½’å®¢æˆ·ç«¯æ•°
    fetches-per-zone 10;            # æ¯åŒºåŸŸæœ€å¤§å¹¶å‘è·å–
};
```

### 6.3 é˜²æŠ¤ç­–ç•¥é…ç½®



**ğŸ›¡ï¸ ç»¼åˆé˜²æŠ¤æœºåˆ¶**
```nginx
# ç»“åˆå¤šç§é˜²æŠ¤æ‰‹æ®µ

options {
#    # åŸºç¡€é™åˆ¶
    rate-limit {
        responses-per-second 20;
        errors-per-second 5;
        slip 2;
    };
    
#    # æŸ¥è¯¢é™åˆ¶
    allow-query { 
        !blacklist;
        internal_networks; 
        trusted_servers; 
    };
    
#    # é€’å½’é™åˆ¶ï¼ˆå…³é”®ï¼‰
    allow-recursion { internal_networks; };
    
#    # ç¼“å­˜ä¿æŠ¤
    allow-query-cache { internal_networks; };
    
#    # å“åº”ç­–ç•¥åŒºåŸŸï¼ˆRPZï¼‰
    response-policy {
        zone "rpz.local";
    };
};

# RPZæ¶æ„åŸŸåæ‹¦æˆª

zone "rpz.local" {
    type master;
    file "/etc/bind/zones/rpz.local.zone";
    allow-query { none; };
};
```

---

## 7. ğŸ•³ï¸ é»‘æ´é…ç½®ä¸IPå±è”½



### 7.1 blackholeé»‘æ´æœºåˆ¶



**ğŸ”¸ é»‘æ´æœºåˆ¶åŸç†**
```
blackholeï¼šå®Œå…¨ä¸¢å¼ƒæ¥è‡ªæŒ‡å®šIPçš„æ‰€æœ‰DNSæŸ¥è¯¢
å¤„ç†æ–¹å¼ï¼šé™é»˜ä¸¢å¼ƒï¼Œä¸è¿”å›ä»»ä½•å“åº”
é€‚ç”¨åœºæ™¯ï¼šå·²ç¡®è®¤çš„æ¶æ„IPåœ°å€
ä¼˜åŠ¿ï¼šèŠ‚çœæœåŠ¡å™¨èµ„æºï¼Œæ— å“åº”æ³„éœ²
```

### 7.2 blackholeé…ç½®å®ç°



**ğŸ•³ï¸ åŸºç¡€é»‘æ´é…ç½®**
```nginx
# é™æ€é»‘æ´é…ç½®

options {
    blackhole {
        192.0.2.0/24;       # å·²çŸ¥æ”»å‡»ç½‘æ®µ
        198.51.100.0/24;    # æ¶æ„æ‰«æç½‘æ®µ
        203.0.113.99;       # ç‰¹å®šæ”»å‡»è€…IP
    };
};

# ç»“åˆACLçš„é»‘æ´é…ç½®

acl "known_attackers" {
    192.0.2.0/24;
    198.51.100.0/24;
    // ä»å¨èƒæƒ…æŠ¥æºç»´æŠ¤çš„IPåˆ—è¡¨
};

options {
    blackhole { known_attackers; };
};
```

### 7.3 åŠ¨æ€é»‘æ´ç®¡ç†



**ğŸ”„ è‡ªåŠ¨åŒ–é»‘æ´æ›´æ–°**
```bash
#!/bin/bash

# /etc/bind/scripts/auto_blackhole.sh


NAMED_CONF="/etc/bind/named.conf.options"
BLACKHOLE_FILE="/etc/bind/blackhole.acl"
LOG_FILE="/var/log/bind/attacks.log"

# åˆ†ææ—¥å¿—å‘ç°æ”»å‡»IP

detect_attacks() {
    echo "ğŸ” åˆ†ææ”»å‡»æ¨¡å¼..."
    
#    # æŸ¥æ‰¾é¢‘ç¹æŸ¥è¯¢çš„IPï¼ˆå¯èƒ½æ˜¯æ‰«æï¼‰
    awk '/query/ {print $6}' /var/log/bind/query.log | \
    sort | uniq -c | sort -nr | \
    awk '$1 > 1000 {print $2}' > /tmp/suspicious_ips.txt
    
#    # æŸ¥æ‰¾é”™è¯¯æŸ¥è¯¢è¿‡å¤šçš„IP
    awk '/NXDOMAIN/ {print $6}' /var/log/bind/query.log | \
    sort | uniq -c | sort -nr | \
    awk '$1 > 100 {print $2}' >> /tmp/suspicious_ips.txt
    
#    # å»é‡å¹¶éªŒè¯IPæ ¼å¼
    sort /tmp/suspicious_ips.txt | uniq | \
    grep -E '^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$' > /tmp/attack_ips.txt
}

# æ›´æ–°é»‘æ´åˆ—è¡¨

update_blackhole() {
    if [[ -s /tmp/attack_ips.txt ]]; then
        echo "ğŸ•³ï¸ æ›´æ–°é»‘æ´åˆ—è¡¨..."
        
#        # å¤‡ä»½å½“å‰é…ç½®
        cp "$BLACKHOLE_FILE" "$BLACKHOLE_FILE.backup"
        
#        # æ·»åŠ æ–°çš„æ”»å‡»IP
        while read -r ip; do
            if ! grep -q "$ip" "$BLACKHOLE_FILE"; then
                echo "    $ip;    # Auto-added $(date)" >> "$BLACKHOLE_FILE"
                echo "$(date): Added $ip to blackhole" >> "$LOG_FILE"
            fi
        done < /tmp/attack_ips.txt
        
#        # é‡æ–°åŠ è½½é…ç½®
        if named-checkconf; then
            systemctl reload bind9
            echo "âœ… é»‘æ´åˆ—è¡¨æ›´æ–°æˆåŠŸ"
        else
            echo "âŒ é…ç½®é”™è¯¯ï¼Œæ¢å¤å¤‡ä»½"
            mv "$BLACKHOLE_FILE.backup" "$BLACKHOLE_FILE"
        fi
    fi
}

# å®šæœŸæ¸…ç†è¿‡æœŸæ¡ç›®ï¼ˆ30å¤©å‰çš„è‡ªåŠ¨æ·»åŠ æ¡ç›®ï¼‰

cleanup_old_entries() {
    local cutoff_date=$(date -d "30 days ago" +%Y-%m-%d)
    sed -i "/Auto-added.*$cutoff_date/d" "$BLACKHOLE_FILE"
}
```

---

## 8. ğŸ­ DNSæ¬ºéª—é˜²æŠ¤æœºåˆ¶



### 8.1 DNSæ¬ºéª—æ”»å‡»ç±»å‹



**ğŸ­ å¸¸è§æ¬ºéª—æ‰‹æ®µ**
```
ç¼“å­˜æŠ•æ¯’ï¼šå‘DNSç¼“å­˜æ³¨å…¥é”™è¯¯è®°å½•
å“åº”ä¼ªé€ ï¼šä¼ªé€ æƒå¨æœåŠ¡å™¨çš„å“åº”
ä¸­é—´äººæ”»å‡»ï¼šæ‹¦æˆªå¹¶ä¿®æ”¹DNSæŸ¥è¯¢å“åº”
åŸŸååŠ«æŒï¼šæ§åˆ¶åŸŸåçš„æƒå¨æœåŠ¡å™¨
```

### 8.2 æºç«¯å£éšæœºåŒ–



**ğŸ² æŸ¥è¯¢æºç«¯å£ä¿æŠ¤**
```nginx
options {
#    # å¯ç”¨æºç«¯å£éšæœºåŒ–ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
    use-v4-udp-ports { range 1024 65535; };
    use-v6-udp-ports { range 1024 65535; };
    
#    # é¿å…å¯é¢„æµ‹çš„ç«¯å£
    avoid-v4-udp-ports { 53; };
    avoid-v6-udp-ports { 53; };
    
#    # æŸ¥è¯¢IDéšæœºåŒ–ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
    query-source address * port *;
    query-source-v6 address * port *;
};
```

### 8.3 å“åº”éªŒè¯æœºåˆ¶



**âœ… ä¸¥æ ¼å“åº”æ£€æŸ¥**
```nginx
options {
#    # å¯ç”¨ä¸¥æ ¼çš„å“åº”æ£€æŸ¥
    check-names master fail;     # ä¸»åŒºåŸŸåç§°æ£€æŸ¥
    check-names slave warn;      # ä»åŒºåŸŸåç§°æ£€æŸ¥
    check-names response ignore; # å“åº”åç§°æ£€æŸ¥
    
#    # é˜²æ­¢ç¼“å­˜æŠ•æ¯’
    dnssec-validation auto;      # å¯ç”¨DNSSECéªŒè¯
    
#    # è¿‡æ»¤ç§æœ‰åœ°å€å“åº”
    filter-aaaa-on-v4 yes;      # è¿‡æ»¤IPv4ä¸Šçš„AAAAæŸ¥è¯¢
    
#    # ç¦ç”¨ä¸å®‰å…¨çš„ç‰¹æ€§
    auth-nxdomain no;           # ä¸å¯¹NXDOMAINè¿›è¡Œæƒå¨åº”ç­”
};
```

### 8.4 DNSSECé…ç½®



**ğŸ” DNSSECæ•°å­—ç­¾åéªŒè¯**
```nginx
# å¯ç”¨DNSSECéªŒè¯

options {
    dnssec-validation auto;      # è‡ªåŠ¨éªŒè¯DNSSEC
    dnssec-enable yes;          # å¯ç”¨DNSSECåŠŸèƒ½
    
#    # ä¿¡ä»»é”šé…ç½®
    managed-keys {
        "." initial-key 257 3 8 "root-key-string-here";
    };
};

# ä¸ºåŒºåŸŸå¯ç”¨DNSSECç­¾å

zone "secure.example.com" {
    type master;
    file "/etc/bind/zones/secure.example.com.zone";
    
#    # å¯ç”¨è‡ªåŠ¨ç­¾å
    auto-dnssec maintain;
    key-directory "/etc/bind/keys";
    
#    # ç­¾åç­–ç•¥
    sig-validity-interval 30;   # ç­¾åæœ‰æ•ˆæœŸ30å¤©
    sig-re-signing-interval 22; # é‡æ–°ç­¾åé—´éš”22å¤©
};
```

---

## 9. ğŸ  chrootç¯å¢ƒå®‰å…¨åŠ å›º



### 9.1 chrootéš”ç¦»åŸç†



**ğŸ”¸ chrootå®‰å…¨æœºåˆ¶**
```
chrootï¼šæ”¹å˜æ ¹ç›®å½•ï¼Œé™åˆ¶è¿›ç¨‹è®¿é—®èŒƒå›´
å®‰å…¨ä»·å€¼ï¼šå³ä½¿DNSæœåŠ¡è¢«æ”»ç ´ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•è®¿é—®çœŸå®ç³»ç»Ÿ
éš”ç¦»èŒƒå›´ï¼šå°†BINDè¿è¡Œåœ¨å—é™çš„æ–‡ä»¶ç³»ç»Ÿç¯å¢ƒä¸­
å®ç°æ–¹å¼ï¼šåˆ›å»ºæœ€å°åŒ–çš„è¿è¡Œç¯å¢ƒ
```

**ğŸ’¡ å½¢è±¡ç†è§£**
chrootå°±åƒç»™DNSæœåŠ¡å»ºé€ ä¸€ä¸ª"è™šæ‹Ÿç›‘ç‹±"ï¼š
- DNSè¿›ç¨‹åªèƒ½çœ‹åˆ°"ç›‘ç‹±"å†…çš„æ–‡ä»¶
- å³ä½¿é€ƒå‡ºDNSç¨‹åºï¼Œä¹Ÿé€ƒä¸å‡ºè¿™ä¸ª"ç›‘ç‹±"
- çœŸå®ç³»ç»Ÿæ–‡ä»¶å¯¹DNSè¿›ç¨‹å®Œå…¨ä¸å¯è§

### 9.2 chrootç¯å¢ƒæ„å»º



**ğŸ—ï¸ åˆ›å»ºchrootç¯å¢ƒ**
```bash
#!/bin/bash

# åˆ›å»ºBIND chrootç¯å¢ƒ


CHROOT_DIR="/var/named/chroot"

# åˆ›å»ºç›®å½•ç»“æ„

setup_chroot_dirs() {
    echo "ğŸ—ï¸ åˆ›å»ºchrootç›®å½•ç»“æ„..."
    
    mkdir -p "$CHROOT_DIR"/{etc,var,usr,dev}
    mkdir -p "$CHROOT_DIR"/var/{named,run/named,log}
    mkdir -p "$CHROOT_DIR"/etc/{bind,rndc}
    mkdir -p "$CHROOT_DIR"/usr/share/dns
    
#    # è®¾ç½®ç›®å½•æƒé™
    chown -R named:named "$CHROOT_DIR"/var/named
    chmod 755 "$CHROOT_DIR"/var/named
    chmod 750 "$CHROOT_DIR"/etc/bind
}

# å¤åˆ¶å¿…è¦æ–‡ä»¶

copy_essential_files() {
    echo "ğŸ“‹ å¤åˆ¶å¿…è¦çš„é…ç½®æ–‡ä»¶..."
    
#    # å¤åˆ¶é…ç½®æ–‡ä»¶
    cp -p /etc/bind/named.conf "$CHROOT_DIR"/etc/bind/
    cp -p /etc/bind/named.conf.* "$CHROOT_DIR"/etc/bind/
    cp -pr /etc/bind/zones "$CHROOT_DIR"/etc/bind/
    
#    # å¤åˆ¶ç³»ç»Ÿæ–‡ä»¶
    cp -p /etc/localtime "$CHROOT_DIR"/etc/
    cp -p /etc/resolv.conf "$CHROOT_DIR"/etc/
    
#    # åˆ›å»ºè®¾å¤‡æ–‡ä»¶
    mknod "$CHROOT_DIR"/dev/null c 1 3
    mknod "$CHROOT_DIR"/dev/random c 1 8
    chmod 666 "$CHROOT_DIR"/dev/{null,random}
}

# é…ç½®ç³»ç»ŸæœåŠ¡

configure_chroot_service() {
    echo "âš™ï¸ é…ç½®chrootæœåŠ¡..."
    
#    # ä¿®æ”¹systemdæœåŠ¡æ–‡ä»¶
    cat > /etc/systemd/system/bind9-chroot.service << 'EOF'
[Unit]
Description=BIND Domain Name Server (chroot)
Documentation=man:named(8)
After=network.target

[Service]
Type=forking
User=named
Group=named
ExecStart=/usr/sbin/named -t /var/named/chroot -u named
ExecReload=/bin/sh -c '/usr/sbin/rndc reload > /dev/null 2>&1 || /bin/kill -HUP $MAINPID'
ExecStop=/usr/sbin/rndc stop
PrivateTmp=true

[Install]
WantedBy=multi-user.target
EOF
    
    systemctl daemon-reload
    systemctl enable bind9-chroot
}
```

### 9.3 chrootç¯å¢ƒç»´æŠ¤



**ğŸ”§ æ—¥å¸¸ç»´æŠ¤è„šæœ¬**
```bash
#!/bin/bash

# chrootç¯å¢ƒç»´æŠ¤å·¥å…·


CHROOT_DIR="/var/named/chroot"

# åŒæ­¥é…ç½®æ–‡ä»¶

sync_configs() {
    echo "ğŸ”„ åŒæ­¥é…ç½®æ–‡ä»¶åˆ°chrootç¯å¢ƒ..."
    
#    # æ£€æŸ¥åŸå§‹é…ç½®æ˜¯å¦æœ‰æ›´æ–°
    if [[ /etc/bind/named.conf -nt "$CHROOT_DIR"/etc/bind/named.conf ]]; then
        echo "ğŸ“ å‘ç°é…ç½®æ›´æ–°ï¼ŒåŒæ­¥ä¸­..."
        cp -p /etc/bind/named.conf* "$CHROOT_DIR"/etc/bind/
        
#        # éªŒè¯é…ç½®
        if named-checkconf -t "$CHROOT_DIR"; then
            echo "âœ… é…ç½®åŒæ­¥æˆåŠŸ"
            systemctl reload bind9-chroot
        else
            echo "âŒ é…ç½®éªŒè¯å¤±è´¥"
            return 1
        fi
    else
        echo "âœ… é…ç½®æ–‡ä»¶æ— å˜æ›´"
    fi
}

# æ£€æŸ¥chrootç¯å¢ƒå®Œæ•´æ€§

check_chroot_integrity() {
    echo "ğŸ” æ£€æŸ¥chrootç¯å¢ƒå®Œæ•´æ€§..."
    
    local essential_files=(
        "etc/bind/named.conf"
        "etc/localtime"
        "dev/null"
        "dev/random"
    )
    
    for file in "${essential_files[@]}"; do
        if [[ ! -e "$CHROOT_DIR/$file" ]]; then
            echo "âŒ ç¼ºå°‘å¿…è¦æ–‡ä»¶: $file"
            return 1
        fi
    done
    
    echo "âœ… chrootç¯å¢ƒå®Œæ•´"
}

# æ¸…ç†æ—¥å¿—æ–‡ä»¶

cleanup_logs() {
    echo "ğŸ§¹ æ¸…ç†chrootç¯å¢ƒæ—¥å¿—..."
    find "$CHROOT_DIR"/var/log -name "*.log" -mtime +30 -delete
    echo "âœ… æ—¥å¿—æ¸…ç†å®Œæˆ"
}
```

### 9.4 é¢å¤–å®‰å…¨åŠ å›º



**ğŸ”’ æ·±åº¦å®‰å…¨é…ç½®**
```bash
# æ–‡ä»¶ç³»ç»Ÿå®‰å…¨é…ç½®

secure_filesystem() {
    echo "ğŸ”’ åŠ å›ºæ–‡ä»¶ç³»ç»Ÿå®‰å…¨..."
    
#    # è®¾ç½®ä¸¥æ ¼çš„æ–‡ä»¶æƒé™
    chmod 750 "$CHROOT_DIR"
    chmod 640 "$CHROOT_DIR"/etc/bind/named.conf*
    chmod 750 "$CHROOT_DIR"/etc/bind
    
#    # ç¦ç”¨ä¸å¿…è¦çš„å¯æ‰§è¡Œæƒé™
    find "$CHROOT_DIR" -type f -executable -exec chmod -x {} \;
    
#    # è®¾ç½®ä¸å¯å˜å±æ€§ï¼ˆå¯é€‰ï¼‰
#    # chattr +i "$CHROOT_DIR"/etc/bind/named.conf
}

# AppArmor/SELinuxé…ç½®

configure_mac() {
    if command -v aa-status >/dev/null 2>&1; then
        echo "ğŸ›¡ï¸ é…ç½®AppArmorç­–ç•¥..."
#        # åˆ›å»ºè‡ªå®šä¹‰AppArmoré…ç½®
        cat > /etc/apparmor.d/usr.sbin.named-chroot << 'EOF'
#include <tunables/global>


/usr/sbin/named {
#  #include <abstractions/base>
#  #include <abstractions/nameservice>
  
  capability net_bind_service,
  capability setgid,
  capability setuid,
  capability sys_chroot,
  
  /var/named/chroot/** r,
  /var/named/chroot/var/named/** rw,
  /var/named/chroot/var/run/named/** rw,
}
EOF
        apparmor_parser -r /etc/apparmor.d/usr.sbin.named-chroot
    fi
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ ACLè®¿é—®æ§åˆ¶ï¼šå®šä¹‰IPåœ°å€ç»„ï¼Œç»Ÿä¸€ç®¡ç†è®¿é—®æƒé™
ğŸ”¸ æŸ¥è¯¢æƒé™æ§åˆ¶ï¼šé™åˆ¶è°å¯ä»¥æŸ¥è¯¢ï¼Œä»€ä¹ˆå¯ä»¥æŸ¥è¯¢
ğŸ”¸ åŒºåŸŸä¼ è¾“æ§åˆ¶ï¼šä¿æŠ¤å®Œæ•´DNSæ•°æ®ä¸è¢«æ³„éœ²
ğŸ”¸ åŠ¨æ€æ›´æ–°æƒé™ï¼šæ§åˆ¶è°å¯ä»¥ä¿®æ”¹DNSè®°å½•
ğŸ”¸ é€Ÿç‡é™åˆ¶ï¼šé˜²æ­¢DDoSæ”»å‡»å’Œèµ„æºæ»¥ç”¨
ğŸ”¸ é»‘æ´æœºåˆ¶ï¼šé™é»˜ä¸¢å¼ƒæ¶æ„IPçš„æŸ¥è¯¢è¯·æ±‚
ğŸ”¸ é˜²æ¬ºéª—æœºåˆ¶ï¼šé€šè¿‡å¤šç§æ‰‹æ®µé˜²æ­¢DNSç¼“å­˜æŠ•æ¯’
ğŸ”¸ chrootéš”ç¦»ï¼šå°†DNSæœåŠ¡è¿è¡Œåœ¨å—é™ç¯å¢ƒä¸­
```

### 10.2 å…³é”®å®‰å…¨é…ç½®è¦ç‚¹



**ğŸ”¹ æœ€é‡è¦çš„å®‰å…¨é…ç½®**
```
1. é€’å½’æŸ¥è¯¢é™åˆ¶ï¼š
   allow-recursion { internal_networks; };  # ç»ä¸èƒ½è®¾ç½®ä¸ºany

2. åŒºåŸŸä¼ è¾“æ§åˆ¶ï¼š
   allow-transfer { none; };  # é»˜è®¤ç¦æ­¢ï¼ŒæŒ‰éœ€å¼€æ”¾

3. åŠ¨æ€æ›´æ–°æ§åˆ¶ï¼š
   allow-update { none; };    # é»˜è®¤ç¦æ­¢ï¼Œä½¿ç”¨TSIGè®¤è¯

4. é»‘æ´é…ç½®ï¼š
   blackhole { known_attackers; };  # å±è”½å·²çŸ¥æ”»å‡»æº
```

**ğŸ”¹ é˜²æŠ¤ä¼˜å…ˆçº§**
| **é…ç½®é¡¹** | **é‡è¦æ€§** | **å¤æ‚åº¦** | **å¿…è¦æ€§** |
|-----------|-----------|-----------|-----------|
| **é€’å½’æŸ¥è¯¢é™åˆ¶** | â­â­â­â­â­ | â­ | å¿…é¡» |
| **åŒºåŸŸä¼ è¾“æ§åˆ¶** | â­â­â­â­ | â­â­ | å¿…é¡» |
| **é€Ÿç‡é™åˆ¶** | â­â­â­â­ | â­â­â­ | å¼ºçƒˆæ¨è |
| **chrootéš”ç¦»** | â­â­â­ | â­â­â­â­ | æ¨è |

### 10.3 å¸¸è§å®‰å…¨è¯¯åŒº



**âŒ å±é™©é…ç½®ç¤ºä¾‹**
```nginx
# å±é™©ï¼šå¼€æ”¾é€’å½’æŸ¥è¯¢ç»™æ‰€æœ‰äºº

options {
    allow-recursion { any; };  # å¯èƒ½è¢«ç”¨äºDDoSæ”»å‡»
};

# å±é™©ï¼šå…è®¸ä»»æ„åŒºåŸŸä¼ è¾“

zone "example.com" {
    allow-transfer { any; };   # ä¼šæ³„éœ²æ‰€æœ‰åŸŸåä¿¡æ¯
};

# å±é™©ï¼šæ— é™åˆ¶çš„åŠ¨æ€æ›´æ–°

zone "example.com" {
    allow-update { any; };     # ä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹DNSè®°å½•
};
```

**âœ… å®‰å…¨é…ç½®åŸåˆ™**
```
æœ€å°æƒé™ï¼šåªç»™å¿…è¦çš„è®¿é—®æƒé™
é»˜è®¤æ‹’ç»ï¼šå…ˆç¦æ­¢æ‰€æœ‰ï¼Œå†æŒ‰éœ€å¼€æ”¾
çºµæ·±é˜²å¾¡ï¼šå¤šå±‚å®‰å…¨æœºåˆ¶ç»“åˆ
æŒç»­ç›‘æ§ï¼šå®šæœŸæ£€æŸ¥å’Œæ›´æ–°å®‰å…¨é…ç½®
```

### 10.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



**ğŸ¯ æŒæ¡ç¨‹åº¦è‡ªæ£€**
- [ ] èƒ½å¤Ÿé…ç½®ACLè®¿é—®æ§åˆ¶åˆ—è¡¨
- [ ] ç†è§£é€’å½’æŸ¥è¯¢çš„å®‰å…¨é£é™©
- [ ] ä¼šè®¾ç½®åŒºåŸŸä¼ è¾“æƒé™æ§åˆ¶
- [ ] èƒ½é…ç½®TSIGå¯†é’¥è®¤è¯
- [ ] æŒæ¡é€Ÿç‡é™åˆ¶é˜²æŠ¤é…ç½®
- [ ] äº†è§£é»‘æ´æœºåˆ¶çš„ä½œç”¨
- [ ] ä¼šæ„å»ºchrootå®‰å…¨ç¯å¢ƒ
- [ ] èƒ½è¯†åˆ«å’Œä¿®å¤å¸¸è§å®‰å…¨é…ç½®é”™è¯¯

**ğŸ”§ å®è·µç»ƒä¹ å»ºè®®**
1. **åŸºç¡€ç»ƒä¹ **ï¼šé…ç½®å†…ç½‘DNSï¼Œé™åˆ¶é€’å½’æŸ¥è¯¢æƒé™
2. **è¿›é˜¶ç»ƒä¹ **ï¼šè®¾ç½®ä¸»ä»DNSï¼Œé…ç½®å®‰å…¨çš„åŒºåŸŸä¼ è¾“
3. **é«˜çº§ç»ƒä¹ **ï¼šæ„å»ºå®Œæ•´çš„chrootç¯å¢ƒï¼Œå¯ç”¨æ‰€æœ‰å®‰å…¨ç‰¹æ€§

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
> DNSå®‰å…¨é…ç½®ä¸‰åŸåˆ™ï¼šé™åˆ¶é€’å½’ã€æ§åˆ¶ä¼ è¾“ã€é˜²æ­¢æ›´æ–°
> çºµæ·±é˜²å¾¡äº”å±‚æ¬¡ï¼šç½‘ç»œã€åº”ç”¨ã€ç³»ç»Ÿã€ç›‘æ§ã€å“åº”
> å®‰å…¨åŠ å›ºé‡ç‚¹ï¼šACLæ§åˆ¶ã€é€Ÿç‡é™åˆ¶ã€ç¯å¢ƒéš”ç¦»

**ğŸ“š å»¶ä¼¸å­¦ä¹ æ–¹å‘**
- DNSSECæ•°å­—ç­¾åæŠ€æœ¯æ·±å…¥å­¦ä¹ 
- DNS over HTTPS (DoH) å’Œ DNS over TLS (DoT)
- DNSå¨èƒæƒ…æŠ¥å’Œè‡ªåŠ¨åŒ–é˜²æŠ¤
- DNSæ—¥å¿—åˆ†æå’Œå¼‚å¸¸æ£€æµ‹