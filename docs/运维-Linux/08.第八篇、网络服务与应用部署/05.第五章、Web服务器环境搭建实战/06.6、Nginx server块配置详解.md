---
title: 6ã€Nginx serverå—é…ç½®è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [serverå—åŸºç¡€æ¦‚å¿µ](#1-serverå—åŸºç¡€æ¦‚å¿µ)
2. [listenæŒ‡ä»¤ç«¯å£ç»‘å®š](#2-listenæŒ‡ä»¤ç«¯å£ç»‘å®š)
3. [server_nameåŸŸååŒ¹é…æœºåˆ¶](#3-server_nameåŸŸååŒ¹é…æœºåˆ¶)
4. [rootä¸aliasæŒ‡ä»¤æ·±åº¦è§£æ](#4-rootä¸aliasæŒ‡ä»¤æ·±åº¦è§£æ)
5. [indexé»˜è®¤é¡µé¢é…ç½®](#5-indexé»˜è®¤é¡µé¢é…ç½®)
6. [locationå—åŒ¹é…è§„åˆ™è¯¦è§£](#6-locationå—åŒ¹é…è§„åˆ™è¯¦è§£)
7. [åŒ¹é…ä¼˜å…ˆçº§ä¸æ‰§è¡Œé¡ºåº](#7-åŒ¹é…ä¼˜å…ˆçº§ä¸æ‰§è¡Œé¡ºåº)
8. [try_filesæ–‡ä»¶æŸ¥æ‰¾æœºåˆ¶](#8-try_filesæ–‡ä»¶æŸ¥æ‰¾æœºåˆ¶)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ serverå—åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯serverå—


**é€šä¿—ç†è§£**ï¼šserverå—å°±åƒæ˜¯ä¸€ä¸ª**è™šæ‹Ÿä¸»æœº**ï¼Œç±»ä¼¼äºä¸€ä¸ªæˆ¿å­é‡Œçš„ä¸åŒæˆ¿é—´ã€‚æ¯ä¸ªserverå—å¯ä»¥å¤„ç†ä¸åŒçš„ç½‘ç«™æˆ–åº”ç”¨ï¼Œè™½ç„¶éƒ½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä½†å½¼æ­¤ç‹¬ç«‹è¿è¡Œã€‚

```
ç”Ÿæ´»æ¯”å–»ï¼š
ä¸€æ ‹å…¬å¯“æ¥¼ â†’ NginxæœåŠ¡å™¨
ä¸åŒæˆ¿é—´   â†’ ä¸åŒserverå—
æ¯ä¸ªæˆ¿é—´æœ‰ç‹¬ç«‹çš„é—¨ç‰Œå· â†’ ä¸åŒçš„åŸŸåå’Œç«¯å£
æ¯ä¸ªæˆ¿é—´æœ‰ä¸åŒçš„å¸ƒå±€   â†’ ä¸åŒçš„é…ç½®è§„åˆ™
```

**ğŸ”¸ serverå—çš„æ ¸å¿ƒä½œç”¨**
- **è™šæ‹Ÿä¸»æœº**ï¼šåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šæ‰˜ç®¡å¤šä¸ªç½‘ç«™
- **è¯·æ±‚åˆ†å‘**ï¼šæ ¹æ®åŸŸåå’Œç«¯å£å°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„ç½‘ç«™
- **é…ç½®éš”ç¦»**ï¼šæ¯ä¸ªç½‘ç«™æœ‰ç‹¬ç«‹çš„é…ç½®ï¼Œäº’ä¸å¹²æ‰°
- **èµ„æºç®¡ç†**ï¼šä¸ºä¸åŒç½‘ç«™åˆ†é…ä¸åŒçš„èµ„æºå’Œæƒé™

### 1.2 serverå—çš„åŸºæœ¬ç»“æ„


**ğŸ“‹ æ ‡å‡†serverå—æ¡†æ¶**
```nginx
server {
    # ç›‘å¬ç«¯å£å’ŒIP
    listen 80;
    listen [::]:80;
    
    # åŸŸååŒ¹é…
    server_name example.com www.example.com;
    
    # ç½‘ç«™æ ¹ç›®å½•
    root /var/www/example.com;
    
    # é»˜è®¤é¦–é¡µ
    index index.html index.htm;
    
    # ä½ç½®è§„åˆ™
    location / {
        try_files $uri $uri/ =404;
    }
}
```

**ğŸ¯ é…ç½®å±‚æ¬¡å…³ç³»**
```
http {                 â† å…¨å±€HTTPé…ç½®
  server {             â† è™šæ‹Ÿä¸»æœº1
    location / {       â† ç½‘ç«™æ ¹è·¯å¾„
    }
    location /api/ {   â† APIæ¥å£è·¯å¾„
    }
  }
  server {             â† è™šæ‹Ÿä¸»æœº2
    location / {       â† å¦ä¸€ä¸ªç½‘ç«™çš„æ ¹è·¯å¾„
    }
  }
}
```

### 1.3 serverå—çš„å·¥ä½œåŸç†


**ğŸ”„ è¯·æ±‚å¤„ç†æµç¨‹**
```
ç”¨æˆ·è®¿é—® www.example.com
       â†“
Nginxæ¥æ”¶è¯·æ±‚
       â†“
æ£€æŸ¥æ‰€æœ‰serverå—çš„listenå’Œserver_name
       â†“
æ‰¾åˆ°åŒ¹é…çš„serverå—
       â†“
åœ¨è¯¥serverå—å†…æŸ¥æ‰¾locationè§„åˆ™
       â†“
æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘
       â†“
è¿”å›å“åº”ç»™ç”¨æˆ·
```

---

## 2. ğŸ§ listenæŒ‡ä»¤ç«¯å£ç»‘å®š


### 2.1 listenæŒ‡ä»¤åŸºç¡€è¯­æ³•


**ğŸ’¡ listenæŒ‡ä»¤çš„ä½œç”¨**
å°±åƒé—¨ç‰Œå·ä¸€æ ·ï¼Œå‘Šè¯‰Nginxè¿™ä¸ªserverå—è¦ç›‘å¬å“ªä¸ªåœ°å€å’Œç«¯å£ã€‚æ²¡æœ‰æ­£ç¡®çš„"é—¨ç‰Œå·"ï¼Œç”¨æˆ·å°±æ‰¾ä¸åˆ°ä½ çš„ç½‘ç«™ã€‚

**ğŸ“ åŸºæœ¬è¯­æ³•æ ¼å¼**
```nginx
listen address:port;
listen port;
listen address;
```

### 2.2 å¸¸ç”¨listené…ç½®ç¤ºä¾‹


**ğŸ”¸ åŸºç¡€ç«¯å£ç›‘å¬**
```nginx
# ç›‘å¬80ç«¯å£ï¼ˆHTTPæ ‡å‡†ç«¯å£ï¼‰
listen 80;

# ç›‘å¬443ç«¯å£ï¼ˆHTTPSæ ‡å‡†ç«¯å£ï¼‰
listen 443 ssl;

# ç›‘å¬è‡ªå®šä¹‰ç«¯å£
listen 8080;
```

**ğŸ”¸ IPåœ°å€ç»‘å®š**
```nginx
# åªç›‘å¬ç‰¹å®šIPçš„80ç«¯å£
listen 192.168.1.100:80;

# ç›‘å¬æ‰€æœ‰IPv4åœ°å€çš„80ç«¯å£
listen 0.0.0.0:80;

# ç›‘å¬IPv6åœ°å€
listen [::]:80;

# åŒæ—¶æ”¯æŒIPv4å’ŒIPv6
listen 80;
listen [::]:80;
```

**ğŸ”¸ é«˜çº§listené€‰é¡¹**
```nginx
# é»˜è®¤serverï¼ˆå½“æ²¡æœ‰åŒ¹é…çš„server_nameæ—¶ä½¿ç”¨ï¼‰
listen 80 default_server;

# å¯ç”¨SSL
listen 443 ssl http2;

# è®¾ç½®æ¥æ”¶ç¼“å†²åŒºå¤§å°
listen 80 rcvbuf=8k;

# è®¾ç½®å‘é€ç¼“å†²åŒºå¤§å°
listen 80 sndbuf=16k;
```

### 2.3 å¤šç«¯å£é…ç½®å®ä¾‹


**ğŸŒŸ å®Œæ•´çš„å¤šç«¯å£é…ç½®**
```nginx
# HTTPç½‘ç«™
server {
    listen 80;
    listen [::]:80;
    server_name example.com www.example.com;
    
    # HTTPè‡ªåŠ¨è·³è½¬åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

# HTTPSç½‘ç«™
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name example.com www.example.com;
    
    root /var/www/example.com;
    index index.html;
}

# ç®¡ç†åå°ï¼ˆè‡ªå®šä¹‰ç«¯å£ï¼‰
server {
    listen 8080;
    server_name admin.example.com;
    
    root /var/www/admin;
    index admin.html;
}
```

### 2.4 listenæŒ‡ä»¤çš„åŒ¹é…è§„åˆ™


**âš–ï¸ ç«¯å£åŒ¹é…ä¼˜å…ˆçº§**
| åŒ¹é…ç±»å‹ | **ä¼˜å…ˆçº§** | **ç¤ºä¾‹** | **è¯´æ˜** |
|---------|-----------|---------|---------|
| `ç²¾ç¡®åŒ¹é…` | `æœ€é«˜` | `192.168.1.100:80` | `IPå’Œç«¯å£å®Œå…¨åŒ¹é…` |
| `IPé€šé…` | `é«˜` | `*:80` | `ä»»æ„IPçš„æŒ‡å®šç«¯å£` |
| `ç«¯å£åŒ¹é…` | `ä¸­` | `80` | `ä»…åŒ¹é…ç«¯å£å·` |
| `é»˜è®¤æœåŠ¡å™¨` | `æœ€ä½` | `default_server` | `å…œåº•åŒ¹é…` |

---

## 3. ğŸŒ server_nameåŸŸååŒ¹é…æœºåˆ¶


### 3.1 server_nameçš„ä½œç”¨åŸç†


**é€šä¿—è§£é‡Š**ï¼šserver_nameå°±åƒæ˜¯**é—¨ç‰Œå·ç **ï¼Œå½“ç”¨æˆ·è¾“å…¥ç½‘å€è®¿é—®æ—¶ï¼ŒNginxä¼šæŸ¥çœ‹è¯·æ±‚çš„åŸŸåï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„serverå—æ¥å¤„ç†è¯·æ±‚ã€‚

**ğŸ” åŸŸååŒ¹é…è¿‡ç¨‹**
```
ç”¨æˆ·è¾“å…¥ï¼šwww.example.com
        â†“
æµè§ˆå™¨å‘é€HTTPè¯·æ±‚ï¼ŒHostå¤´åŒ…å«ï¼šwww.example.com
        â†“
Nginxæ£€æŸ¥æ‰€æœ‰serverå—çš„server_name
        â†“
æ‰¾åˆ°åŒ¹é… server_name www.example.com; çš„serverå—
        â†“
ä½¿ç”¨è¯¥serverå—å¤„ç†è¯·æ±‚
```

### 3.2 server_nameé…ç½®ç±»å‹


**ğŸ”¸ ç²¾ç¡®åŒ¹é…**
```nginx
# ç²¾ç¡®åŸŸååŒ¹é…
server_name example.com;
server_name www.example.com;

# å¤šä¸ªç²¾ç¡®åŸŸå
server_name example.com www.example.com blog.example.com;
```

**ğŸ”¸ é€šé…ç¬¦åŒ¹é…**
```nginx
# å‰ç¼€é€šé…ç¬¦
server_name *.example.com;    # åŒ¹é… blog.example.com, api.example.com

# åç¼€é€šé…ç¬¦  
server_name example.*;        # åŒ¹é… example.com, example.net

# æ··åˆä½¿ç”¨
server_name *.example.com example.com;
```

**ğŸ”¸ æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…**
```nginx
# æ­£åˆ™åŒ¹é…ï¼ˆä»¥~å¼€å¤´ï¼‰
server_name ~^(www\.)?(.+)$;

# æ•è·ç»„åº”ç”¨
server_name ~^(?<subdomain>.+)\.example\.com$;
```

### 3.3 åŸŸååŒ¹é…ä¼˜å…ˆçº§


**ğŸ“Š åŒ¹é…ä¼˜å…ˆçº§é¡ºåº**
```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š

1. ç²¾ç¡®åŒ¹é…
   server_name example.com;

2. å‰ç¼€é€šé…ç¬¦åŒ¹é…  
   server_name *.example.com;

3. åç¼€é€šé…ç¬¦åŒ¹é…
   server_name example.*;

4. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
   server_name ~^(.+)\.example\.com$;

5. é»˜è®¤server
   listen 80 default_server;
```

### 3.4 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å¤šåŸŸåç½‘ç«™é…ç½®**
```nginx
# ä¸»ç½‘ç«™
server {
    listen 80;
    server_name example.com www.example.com;
    root /var/www/main;
}

# å­åŸŸåç½‘ç«™
server {
    listen 80;
    server_name blog.example.com;
    root /var/www/blog;
}

# é€šé…ç¬¦å¤„ç†æ‰€æœ‰å­åŸŸå
server {
    listen 80;
    server_name *.dev.example.com;
    root /var/www/development;
}
```

**ğŸ”§ åŸŸåé‡å®šå‘é…ç½®**
```nginx
# ç»Ÿä¸€è·³è½¬åˆ°å¸¦wwwçš„åŸŸå
server {
    listen 80;
    server_name example.com;
    return 301 http://www.example.com$request_uri;
}

# å¤„ç†å¸¦wwwçš„åŸŸå
server {
    listen 80;
    server_name www.example.com;
    root /var/www/website;
}
```

---

## 4. ğŸ“ rootä¸aliasæŒ‡ä»¤æ·±åº¦è§£æ


### 4.1 rootæŒ‡ä»¤è¯¦è§£


**ğŸ’¡ rootæŒ‡ä»¤çš„å«ä¹‰**
rootæŒ‡ä»¤è®¾å®šç½‘ç«™çš„**æ ¹ç›®å½•**ï¼Œå°±åƒå‘Šè¯‰Nginx"è¿™ä¸ªç½‘ç«™çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œ"ã€‚

**ğŸ”¸ rootæŒ‡ä»¤å·¥ä½œåŸç†**
```nginx
server {
    server_name example.com;
    root /var/www/example;
    
    location /images/ {
        # ç»§æ‰¿serverçš„rootè®¾ç½®
        # è®¿é—® /images/photo.jpg
        # å®é™…æ–‡ä»¶è·¯å¾„: /var/www/example/images/photo.jpg
    }
}
```

**ğŸ“‚ rootè·¯å¾„æ„å»ºè§„åˆ™**
```
ç”¨æˆ·è¯·æ±‚: http://example.com/images/photo.jpg
rootè®¾ç½®: /var/www/example
location: /images/

å®é™…æ–‡ä»¶è·¯å¾„ = root + å®Œæ•´URIè·¯å¾„
             = /var/www/example + /images/photo.jpg
             = /var/www/example/images/photo.jpg
```

### 4.2 aliasæŒ‡ä»¤è¯¦è§£


**ğŸ’¡ aliasæŒ‡ä»¤çš„å«ä¹‰**
aliasæŒ‡ä»¤åˆ›å»ºè·¯å¾„**åˆ«å**ï¼Œå¯ä»¥æŠŠURLè·¯å¾„æ˜ å°„åˆ°å®Œå…¨ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚

**ğŸ”¸ aliasæŒ‡ä»¤å·¥ä½œåŸç†**
```nginx
location /images/ {
    alias /data/pictures/;
    # è®¿é—® /images/photo.jpg
    # å®é™…æ–‡ä»¶è·¯å¾„: /data/pictures/photo.jpg
}
```

**ğŸ“‚ aliasè·¯å¾„æ„å»ºè§„åˆ™**
```
ç”¨æˆ·è¯·æ±‚: http://example.com/images/photo.jpg
location: /images/
alias:    /data/pictures/

å®é™…æ–‡ä»¶è·¯å¾„ = alias + (URIè·¯å¾„ - locationè·¯å¾„)
             = /data/pictures/ + (images/photo.jpg - images/)
             = /data/pictures/photo.jpg
```

### 4.3 rootä¸aliasçš„å…³é”®åŒºåˆ«


**âš–ï¸ å¯¹æ¯”åˆ†æè¡¨**
| æŒ‡ä»¤ | **è·¯å¾„å¤„ç†æ–¹å¼** | **ä½¿ç”¨åœºæ™¯** | **æ³¨æ„äº‹é¡¹** |
|------|-----------------|-------------|-------------|
| `root` | `root + å®Œæ•´URIè·¯å¾„` | `æ­£å¸¸ç½‘ç«™ç›®å½•` | `ç›®å½•ç»“æ„éœ€è¦åŒ¹é…URI` |
| `alias` | `alias + URIå»é™¤locationéƒ¨åˆ†` | `è·¯å¾„é‡æ˜ å°„` | `åªèƒ½ç”¨åœ¨locationå—ä¸­` |

**ğŸ¯ å®é™…å¯¹æ¯”ç¤ºä¾‹**
```nginx
# ä½¿ç”¨root
location /downloads/ {
    root /var/www;
    # è®¿é—® /downloads/file.zip
    # æ–‡ä»¶è·¯å¾„: /var/www/downloads/file.zip
}

# ä½¿ç”¨alias  
location /downloads/ {
    alias /data/files/;
    # è®¿é—® /downloads/file.zip
    # æ–‡ä»¶è·¯å¾„: /data/files/file.zip
}
```

### 4.4 å…¸å‹åº”ç”¨åœºæ™¯


**ğŸ“‹ rootæŒ‡ä»¤é€‚ç”¨åœºæ™¯**
```nginx
# æ ‡å‡†ç½‘ç«™é…ç½®
server {
    server_name blog.example.com;
    root /var/www/blog;     # ç½‘ç«™æ ¹ç›®å½•
    
    location / {
        # è‡ªåŠ¨ç»§æ‰¿rootè®¾ç½®
        try_files $uri $uri/ /index.html;
    }
}
```

**ğŸ“‹ aliasæŒ‡ä»¤é€‚ç”¨åœºæ™¯**
```nginx
# æ–‡ä»¶ä¸‹è½½åŒºåŸŸ
location /downloads/ {
    alias /data/public-files/;
}

# é™æ€èµ„æºCDNé£æ ¼è·¯å¾„
location /static/css/ {
    alias /var/cache/css-files/;
}

# ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
location /uploads/ {
    alias /data/user-uploads/;
}
```

**âš ï¸ å¸¸è§é…ç½®é™·é˜±**
```nginx
# é”™è¯¯é…ç½® - aliasè·¯å¾„å¿…é¡»ä»¥/ç»“å°¾
location /images/ {
    alias /data/pictures;    # ç¼ºå°‘ç»“å°¾çš„/
}

# æ­£ç¡®é…ç½®
location /images/ {
    alias /data/pictures/;   # æ­£ç¡®çš„ç»“å°¾/
}

# é”™è¯¯é…ç½® - rootä¸éœ€è¦è€ƒè™‘locationè·¯å¾„
location /assets/ {
    root /var/www/assets;    # è¿™ä¼šå¯¼è‡´è·¯å¾„å˜æˆ /var/www/assets/assets/
}

# æ­£ç¡®é…ç½®
location /assets/ {
    root /var/www;           # è·¯å¾„æ­£ç¡®: /var/www/assets/
}
```

---

## 5. ğŸ“„ indexé»˜è®¤é¡µé¢é…ç½®


### 5.1 indexæŒ‡ä»¤åŸºç¡€


**ğŸ’¡ indexæŒ‡ä»¤çš„ä½œç”¨**
å½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªç›®å½•ï¼ˆè€Œä¸æ˜¯å…·ä½“æ–‡ä»¶ï¼‰æ—¶ï¼ŒindexæŒ‡ä»¤å‘Šè¯‰Nginxåº”è¯¥å±•ç¤ºå“ªä¸ªæ–‡ä»¶ã€‚å°±åƒå•†åº—çš„**é—¨é¢æ‹›ç‰Œ**ï¼Œå†³å®šå®¢æˆ·é¦–å…ˆçœ‹åˆ°ä»€ä¹ˆã€‚

**ğŸ”¸ å·¥ä½œåŸç†ç¤ºä¾‹**
```
ç”¨æˆ·è®¿é—®: http://example.com/
NginxæŸ¥æ‰¾: /var/www/html/ ç›®å½•ä¸‹çš„é»˜è®¤æ–‡ä»¶
indexè®¾ç½®: index.html index.htm index.php

æŸ¥æ‰¾é¡ºåº:
1. å…ˆæ‰¾ index.html
2. æ²¡æœ‰å°±æ‰¾ index.htm  
3. å†æ²¡æœ‰å°±æ‰¾ index.php
4. éƒ½æ²¡æœ‰å°±è¿”å›403æˆ–404é”™è¯¯
```

### 5.2 indexé…ç½®è¯­æ³•


**ğŸ“ åŸºæœ¬è¯­æ³•æ ¼å¼**
```nginx
index file1 file2 file3;
```

**ğŸ”¸ å¸¸ç”¨é…ç½®ç¤ºä¾‹**
```nginx
# é™æ€ç½‘ç«™é…ç½®
index index.html index.htm;

# PHPç½‘ç«™é…ç½®
index index.php index.html index.htm;

# å¤šè¯­è¨€ç½‘ç«™é…ç½®  
index index.html index.htm default.html;

# å®Œå…¨è‡ªå®šä¹‰
index home.html main.html;
```

### 5.3 indexæŒ‡ä»¤çš„ä½œç”¨åŸŸ


**ğŸ¯ ä¸åŒçº§åˆ«çš„indexé…ç½®**
```nginx
http {
    # å…¨å±€é»˜è®¤index
    index index.html index.htm;
    
    server {
        # serverçº§åˆ«indexï¼ˆè¦†ç›–å…¨å±€ï¼‰
        index index.php index.html;
        
        location / {
            # locationçº§åˆ«indexï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
            index home.html index.html;
        }
        
        location /admin/ {
            # ç®¡ç†åŒºåŸŸä¸“ç”¨é¦–é¡µ
            index admin.html dashboard.html;
        }
    }
}
```

**ğŸ“Š ä¼˜å…ˆçº§é¡ºåº**
```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š
locationçº§åˆ« > serverçº§åˆ« > httpçº§åˆ«

å®é™…æŸ¥æ‰¾è¿‡ç¨‹ï¼š
1. æ£€æŸ¥å½“å‰locationæ˜¯å¦æœ‰indexè®¾ç½®
2. æ²¡æœ‰åˆ™æ£€æŸ¥serverå—çš„indexè®¾ç½®  
3. éƒ½æ²¡æœ‰åˆ™ä½¿ç”¨httpå—çš„å…¨å±€indexè®¾ç½®
```

### 5.4 indexä¸ä¸åŒæ–‡ä»¶ç±»å‹


**ğŸ”¸ é™æ€æ–‡ä»¶index**
```nginx
server {
    root /var/www/static-site;
    index index.html index.htm;
    
    location / {
        try_files $uri $uri/ =404;
    }
}
```

**ğŸ”¸ PHPåŠ¨æ€ç½‘ç«™index**
```nginx
server {
    root /var/www/php-site;
    index index.php index.html;
    
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }
}
```

### 5.5 indexçš„å®é™…åº”ç”¨åœºæ™¯


**ğŸ¨ å¤šç‰ˆæœ¬ç½‘ç«™ç®¡ç†**
```nginx
# æ ¹æ®ç¯å¢ƒæ˜¾ç¤ºä¸åŒé¦–é¡µ
server {
    root /var/www/website;
    
    location / {
        # ç”Ÿäº§ç¯å¢ƒ
        index index.html;
    }
    
    location /beta/ {
        # æµ‹è¯•ç¯å¢ƒ
        index beta.html index.html;
    }
    
    location /dev/ {
        # å¼€å‘ç¯å¢ƒ  
        index dev.html debug.html;
    }
}
```

**ğŸ”§ ç»´æŠ¤æ¨¡å¼é…ç½®**
```nginx
server {
    root /var/www/site;
    
    # æ­£å¸¸æƒ…å†µä¸‹çš„index
    set $maintenance off;
    
    # ç»´æŠ¤æ¨¡å¼åˆ¤æ–­
    if (-f /var/www/maintenance.flag) {
        set $maintenance on;
    }
    
    location / {
        if ($maintenance = on) {
            # ç»´æŠ¤æœŸé—´æ˜¾ç¤ºç»´æŠ¤é¡µé¢
            rewrite ^.*$ /maintenance.html last;
        }
        
        index index.html index.htm;
        try_files $uri $uri/ =404;
    }
}
```

---

## 6. ğŸ“ locationå—åŒ¹é…è§„åˆ™è¯¦è§£


### 6.1 locationå—åŸºç¡€æ¦‚å¿µ


**ğŸ’¡ locationå—çš„ä½œç”¨**
locationå—å°±åƒç½‘ç«™å†…éƒ¨çš„**æˆ¿é—´é—¨ç‰Œ**ï¼Œå‘Šè¯‰Nginxé’ˆå¯¹ä¸åŒçš„URLè·¯å¾„åº”è¯¥åšä»€ä¹ˆå¤„ç†ã€‚æ¯ä¸ªlocationå—è´Ÿè´£å¤„ç†ç‰¹å®šæ¨¡å¼çš„URLè¯·æ±‚ã€‚

**ğŸ”¸ locationå—çš„åŸºæœ¬è¯­æ³•**
```nginx
location [ä¿®é¥°ç¬¦] è·¯å¾„æ¨¡å¼ {
    # å¤„ç†æŒ‡ä»¤
}
```

### 6.2 locationåŒ¹é…ä¿®é¥°ç¬¦


**ğŸ“‹ ä¿®é¥°ç¬¦ç±»å‹è¯¦è§£**

| ä¿®é¥°ç¬¦ | **åŒ¹é…ç±»å‹** | **è¯´æ˜** | **ç¤ºä¾‹** |
|--------|-------------|---------|---------|
| `=` | `ç²¾ç¡®åŒ¹é…` | `URLå¿…é¡»å®Œå…¨ç›¸åŒ` | `location = / { }` |
| `^~` | `å‰ç¼€åŒ¹é…ä¼˜å…ˆ` | `åŒ¹é…å‰ç¼€ä¸”ä¸æ£€æŸ¥æ­£åˆ™` | `location ^~ /images/ { }` |
| `~` | `æ­£åˆ™åŒ¹é…(åŒºåˆ†å¤§å°å†™)` | `æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼` | `location ~ \.php$ { }` |
| `~*` | `æ­£åˆ™åŒ¹é…(ä¸åŒºåˆ†å¤§å°å†™)` | `å¿½ç•¥å¤§å°å†™çš„æ­£åˆ™` | `location ~* \.(jpg|png)$ { }` |
| `æ— ä¿®é¥°ç¬¦` | `å‰ç¼€åŒ¹é…` | `æ™®é€šå‰ç¼€åŒ¹é…` | `location /api/ { }` |

### 6.3 å„ç±»åŒ¹é…è§„åˆ™è¯¦è§£


**ğŸ¯ ç²¾ç¡®åŒ¹é… (=)**
```nginx
# åªåŒ¹é…æ ¹è·¯å¾„ /
location = / {
    return 200 "é¦–é¡µ";
}

# åªåŒ¹é… /login
location = /login {
    return 200 "ç™»å½•é¡µé¢";
}

# ä¸ä¼šåŒ¹é… /login/ æˆ– /login123
```

**ğŸ¯ å‰ç¼€åŒ¹é…ä¼˜å…ˆ (^~)**
```nginx
# åŒ¹é…æ‰€æœ‰ä»¥ /images/ å¼€å¤´çš„è·¯å¾„
location ^~ /images/ {
    root /var/www/static;
    # å³ä½¿åé¢æœ‰æ­£åˆ™åŒ¹é…è§„åˆ™ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œ
}

# åŒ¹é… /images/photo.jpg, /images/folder/pic.png ç­‰
```

**ğŸ¯ æ­£åˆ™åŒ¹é… (~)**
```nginx
# åŒ¹é…æ‰€æœ‰ .php ç»“å°¾çš„æ–‡ä»¶
location ~ \.php$ {
    fastcgi_pass 127.0.0.1:9000;
}

# åŒ¹é…ç‰¹å®šæ–‡ä»¶æ‰©å±•å
location ~ \.(css|js|png|jpg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

**ğŸ¯ å¤§å°å†™æ— å…³æ­£åˆ™åŒ¹é… (~*)**
```nginx
# åŒ¹é…å›¾ç‰‡æ–‡ä»¶ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
location ~* \.(jpg|jpeg|png|gif|bmp|webp)$ {
    root /var/www/images;
}

# å¯ä»¥åŒ¹é… .JPG, .PNG, .gif ç­‰å„ç§å¤§å°å†™ç»„åˆ
```

**ğŸ¯ æ™®é€šå‰ç¼€åŒ¹é…**
```nginx
# åŒ¹é…æ‰€æœ‰ä»¥ /api/ å¼€å¤´çš„è·¯å¾„
location /api/ {
    proxy_pass http://backend;
}

# åŒ¹é…æ‰€æœ‰ä»¥ /admin å¼€å¤´çš„è·¯å¾„
location /admin {
    auth_basic "Admin Area";
    auth_basic_user_file /etc/nginx/.htpasswd;
}
```

### 6.4 locationåŒ¹é…ç¤ºä¾‹é›†åˆ


**ğŸ”§ å®Œæ•´çš„locationé…ç½®ç¤ºä¾‹**
```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/example;
    
    # ç²¾ç¡®åŒ¹é…é¦–é¡µ
    location = / {
        try_files /index.html =404;
    }
    
    # ä¼˜å…ˆåŒ¹é…é™æ€èµ„æºç›®å½•
    location ^~ /static/ {
        alias /var/www/static-files/;
        expires 30d;
    }
    
    # å¤„ç†PHPæ–‡ä»¶
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }
    
    # å¤„ç†å„ç§å›¾ç‰‡æ ¼å¼
    location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public";
    }
    
    # APIæ¥å£ä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:3000/;
        proxy_set_header Host $host;
    }
    
    # ç®¡ç†åå°
    location /admin/ {
        auth_basic "Admin Panel";
        auth_basic_user_file /etc/nginx/.htpasswd;
        try_files $uri $uri/ /admin/index.html;
    }
    
    # é»˜è®¤å¤„ç†ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
    location / {
        try_files $uri $uri/ =404;
    }
}
```

---

## 7. âš–ï¸ åŒ¹é…ä¼˜å…ˆçº§ä¸æ‰§è¡Œé¡ºåº


### 7.1 ä¼˜å…ˆçº§è§„åˆ™æ€»è§ˆ


**ğŸ† ä¼˜å…ˆçº§ä»é«˜åˆ°ä½æ’åº**
```
1. ç²¾ç¡®åŒ¹é… (=)
   â†“
2. å‰ç¼€åŒ¹é…ä¼˜å…ˆ (^~)  
   â†“
3. æ­£åˆ™åŒ¹é… (~, ~*)ï¼ˆæŒ‰é…ç½®æ–‡ä»¶ä¸­çš„é¡ºåºï¼‰
   â†“
4. æ™®é€šå‰ç¼€åŒ¹é…ï¼ˆæŒ‰æœ€é•¿åŒ¹é…åŸåˆ™ï¼‰
```

### 7.2 ä¼˜å…ˆçº§åŒ¹é…è¿‡ç¨‹


**ğŸ” Nginxçš„åŒ¹é…ç®—æ³•**
```
æ­¥éª¤1: æ”¶é›†æ‰€æœ‰locationå—
æ­¥éª¤2: æ£€æŸ¥ç²¾ç¡®åŒ¹é… (=)
       â””â”€â”€ æ‰¾åˆ°åˆ™ç«‹å³ä½¿ç”¨ï¼Œç»“æŸåŒ¹é…
æ­¥éª¤3: æ£€æŸ¥æ‰€æœ‰å‰ç¼€åŒ¹é…ï¼ˆåŒ…æ‹¬^~å’Œæ™®é€šå‰ç¼€ï¼‰
       â””â”€â”€ è®°å½•æœ€é•¿åŒ¹é…çš„å‰ç¼€
æ­¥éª¤4: å¦‚æœæœ€é•¿åŒ¹é…æ˜¯^~ç±»å‹
       â””â”€â”€ ç«‹å³ä½¿ç”¨ï¼Œç»“æŸåŒ¹é…
æ­¥éª¤5: æŒ‰é…ç½®æ–‡ä»¶é¡ºåºæ£€æŸ¥æ­£åˆ™åŒ¹é…
       â””â”€â”€ æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ­£åˆ™ï¼Œç«‹å³ä½¿ç”¨
æ­¥éª¤6: å¦‚æœæ²¡æœ‰æ­£åˆ™åŒ¹é…æˆåŠŸ
       â””â”€â”€ ä½¿ç”¨ä¹‹å‰è®°å½•çš„æœ€é•¿å‰ç¼€åŒ¹é…
```

### 7.3 ä¼˜å…ˆçº§å®æˆ˜ç¤ºä¾‹


**ğŸ¯ å¤æ‚ä¼˜å…ˆçº§æµ‹è¯•é…ç½®**
```nginx
server {
    listen 80;
    server_name test.example.com;
    
    # 1. ç²¾ç¡®åŒ¹é… - æœ€é«˜ä¼˜å…ˆçº§
    location = /test {
        return 200 "ç²¾ç¡®åŒ¹é… /test";
    }
    
    # 2. å‰ç¼€åŒ¹é…ä¼˜å…ˆ
    location ^~ /test {
        return 200 "å‰ç¼€åŒ¹é…ä¼˜å…ˆ ^~ /test";
    }
    
    # 3. æ­£åˆ™åŒ¹é…ï¼ˆæŒ‰é¡ºåºï¼‰
    location ~ ^/test {
        return 200 "æ­£åˆ™åŒ¹é…1 ~ ^/test";
    }
    
    location ~ /test {
        return 200 "æ­£åˆ™åŒ¹é…2 ~ /test";
    }
    
    # 4. æ™®é€šå‰ç¼€åŒ¹é…
    location /test {
        return 200 "æ™®é€šå‰ç¼€åŒ¹é… /test";
    }
    
    location /test/long/path {
        return 200 "æ›´é•¿çš„å‰ç¼€åŒ¹é…";
    }
}
```

**ğŸ“Š ä¸åŒURLçš„åŒ¹é…ç»“æœ**
```
è®¿é—®URL: /test
åŒ¹é…ç»“æœ: "ç²¾ç¡®åŒ¹é… /test" (= ä¼˜å…ˆçº§æœ€é«˜)

è®¿é—®URL: /test/
åŒ¹é…ç»“æœ: "å‰ç¼€åŒ¹é…ä¼˜å…ˆ ^~ /test" (^~ é˜»æ­¢æ­£åˆ™æ£€æŸ¥)

è®¿é—®URL: /test123
åŒ¹é…ç»“æœ: "å‰ç¼€åŒ¹é…ä¼˜å…ˆ ^~ /test" (^~ ä»ç„¶åŒ¹é…)

å‡è®¾å»æ‰ ^~ é…ç½®ï¼š
è®¿é—®URL: /test123  
åŒ¹é…ç»“æœ: "æ­£åˆ™åŒ¹é…1 ~ ^/test" (ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ­£åˆ™)
```

### 7.4 æœ€é•¿åŒ¹é…åŸåˆ™


**ğŸ“ å‰ç¼€åŒ¹é…çš„é•¿åº¦æ¯”è¾ƒ**
```nginx
location /api {
    return 200 "çŸ­å‰ç¼€ /api";
}

location /api/v1 {
    return 200 "é•¿å‰ç¼€ /api/v1";
}

location /api/v1/users {
    return 200 "æœ€é•¿å‰ç¼€ /api/v1/users";
}

# æµ‹è¯•ç»“æœï¼š
# /api/test      â†’ "çŸ­å‰ç¼€ /api"
# /api/v1/test   â†’ "é•¿å‰ç¼€ /api/v1"  
# /api/v1/users/123 â†’ "æœ€é•¿å‰ç¼€ /api/v1/users"
```

### 7.5 å¸¸è§ä¼˜å…ˆçº§é™·é˜±


**âš ï¸ é…ç½®é™·é˜±ç¤ºä¾‹**
```nginx
# é™·é˜±1ï¼šæ­£åˆ™é¡ºåºå¾ˆé‡è¦
location ~ \.php$ {
    return 200 "PHPæ–‡ä»¶";
}

location ~ \.(php|html)$ {
    return 200 "PHPæˆ–HTMLæ–‡ä»¶";  # æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
}

# é™·é˜±2ï¼š^~ é˜»æ­¢æ­£åˆ™æ£€æŸ¥
location ^~ /uploads/ {
    # è¿™ä¸ªé…ç½®ä¼šé˜»æ­¢ä¸‹é¢çš„PHPå¤„ç†
}

location ~ \.php$ {
    # /uploads/test.php ä¸ä¼šåˆ°è¾¾è¿™é‡Œ
}

# æ­£ç¡®åšæ³•ï¼šåœ¨ ^~ å—å†…å¤„ç†PHP
location ^~ /uploads/ {
    location ~ \.php$ {
        # åœ¨è¿™é‡Œå¤„ç†ä¸Šä¼ ç›®å½•ä¸­çš„PHPæ–‡ä»¶
    }
}
```

---

## 8. ğŸ” try_filesæ–‡ä»¶æŸ¥æ‰¾æœºåˆ¶


### 8.1 try_filesæŒ‡ä»¤åŸºç¡€


**ğŸ’¡ try_filesçš„ä½œç”¨**
try_fileså°±åƒä¸€ä¸ª**æ™ºèƒ½é—¨å«**ï¼Œå½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæŒ‰ç…§é¢„è®¾çš„é¡ºåºå»æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶æˆ–è€…æ‰§è¡Œæœ€åçš„å¤‡é€‰æ“ä½œã€‚

**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```nginx
try_files $uri $uri/ /fallback;
```

**ğŸ” å·¥ä½œæµç¨‹è§£é‡Š**
```
ç”¨æˆ·è¯·æ±‚: /blog/article-1
        â†“
try_files $uri $uri/ /index.php;
        â†“
æ­¥éª¤1: æŸ¥æ‰¾æ–‡ä»¶ /blog/article-1
æ­¥éª¤2: æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒæŸ¥æ‰¾ç›®å½• /blog/article-1/
æ­¥éª¤3: ç›®å½•ä¸å­˜åœ¨ï¼Œæ‰§è¡Œ /index.php
```

### 8.2 try_fileså‚æ•°è¯¦è§£


**ğŸ“‹ å‚æ•°ç±»å‹è¯´æ˜**
- `$uri` - å½“å‰è¯·æ±‚çš„URIè·¯å¾„
- `$uri/` - å½“å‰URIè·¯å¾„ä½œä¸ºç›®å½•ï¼ˆè‡ªåŠ¨æ·»åŠ ç›®å½•ç´¢å¼•ï¼‰
- `/fallback` - æœ€åçš„å¤‡é€‰æ–¹æ¡ˆï¼ˆå¿…é¡»å­˜åœ¨ï¼‰
- `=code` - ç›´æ¥è¿”å›HTTPçŠ¶æ€ç 

**ğŸ”¸ å¸¸ç”¨å‚æ•°ç»„åˆ**
```nginx
# æ ‡å‡†é™æ€ç½‘ç«™é…ç½®
try_files $uri $uri/ =404;

# å•é¡µåº”ç”¨(SPA)é…ç½®
try_files $uri $uri/ /index.html;

# PHPæ¡†æ¶é…ç½®
try_files $uri $uri/ /index.php?$query_string;

# å¸¦ç¼“å­˜çš„é…ç½®
try_files $uri $uri/ @cache;
```

### 8.3 try_fileså®é™…åº”ç”¨åœºæ™¯


**ğŸŒŸ é™æ€ç½‘ç«™é…ç½®**
```nginx
server {
    root /var/www/static-site;
    index index.html;
    
    location / {
        # æŸ¥æ‰¾æ–‡ä»¶ â†’ æŸ¥æ‰¾ç›®å½• â†’ è¿”å›404
        try_files $uri $uri/ =404;
    }
}

# è¯·æ±‚ /about çš„æŸ¥æ‰¾è¿‡ç¨‹ï¼š
# 1. æŸ¥æ‰¾ /var/www/static-site/about æ–‡ä»¶
# 2. æŸ¥æ‰¾ /var/www/static-site/about/ ç›®å½•
# 3. å¦‚æœç›®å½•å­˜åœ¨ä¸”æœ‰index.htmlï¼Œè¿”å›index.html
# 4. éƒ½ä¸å­˜åœ¨åˆ™è¿”å›404
```

**ğŸ¨ å•é¡µåº”ç”¨(SPA)é…ç½®**
```nginx
server {
    root /var/www/react-app;
    index index.html;
    
    location / {
        # æ‰€æœ‰è·¯ç”±éƒ½æŒ‡å‘index.htmlï¼Œè®©å‰ç«¯è·¯ç”±å¤„ç†
        try_files $uri $uri/ /index.html;
    }
}

# React/Vueç­‰SPAåº”ç”¨çš„å®Œç¾é…ç½®
# æ— è®ºè®¿é—® /dashboardã€/users/123 ç­‰ä»»ä½•è·¯å¾„
# æœ€ç»ˆéƒ½ä¼šè¿”å› index.htmlï¼Œç”±å‰ç«¯JavaScriptå¤„ç†è·¯ç”±
```

**âš™ï¸ PHPæ¡†æ¶é…ç½®**
```nginx
server {
    root /var/www/laravel/public;
    index index.php;
    
    location / {
        # Laravelæ¡†æ¶çš„æ ‡å‡†é…ç½®
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }
}
```

### 8.4 try_filesé«˜çº§ç”¨æ³•


**ğŸ”§ ä½¿ç”¨å‘½ålocation**
```nginx
location / {
    try_files $uri $uri/ @rewrite;
}

# å‘½ålocationå¤„ç†å›é€€
location @rewrite {
    rewrite ^.*$ /index.php last;
}

# ä¼˜åŠ¿ï¼šå¯ä»¥å¤ç”¨å‘½ålocationï¼Œé…ç½®æ›´æ¸…æ™°
```

**ğŸ¯ å¤šçº§å›é€€ç­–ç•¥**
```nginx
location / {
    # å¤æ‚çš„å›é€€ç­–ç•¥
    try_files $uri $uri/ @cache @dynamic;
}

location @cache {
    # å°è¯•ä»ç¼“å­˜è·å–
    try_files /cache$uri @dynamic;
}

location @dynamic {
    # æœ€ç»ˆå›é€€åˆ°åŠ¨æ€å¤„ç†
    proxy_pass http://backend;
}
```

**âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®**
```nginx
# é™æ€èµ„æºä¼˜åŒ–
location ~* \.(css|js|jpg|png|gif)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    
    # é™æ€èµ„æºç›´æ¥æŸ¥æ‰¾ï¼Œä¸éœ€è¦ç›®å½•å›é€€
    try_files $uri =404;
}

# APIæ¥å£é…ç½®
location /api/ {
    # APIæ¥å£ä¸éœ€è¦æ–‡ä»¶æŸ¥æ‰¾ï¼Œç›´æ¥ä»£ç†
    try_files $uri @api;
}

location @api {
    proxy_pass http://api-backend;
}
```

### 8.5 try_fileså¸¸è§é—®é¢˜


**âŒ å¸¸è§é…ç½®é”™è¯¯**
```nginx
# é”™è¯¯1ï¼šç¼ºå°‘æœ€åçš„å¤‡é€‰æ–¹æ¡ˆ
location / {
    try_files $uri $uri/;  # é”™è¯¯ï¼šç¼ºå°‘æœ€åçš„å¤‡é€‰
}

# æ­£ç¡®å†™æ³•
location / {
    try_files $uri $uri/ =404;
}

# é”™è¯¯2ï¼šåœ¨proxy_passä¸­ä½¿ç”¨try_files
location /api/ {
    try_files $uri @proxy;  # å¤šä½™çš„try_files
    proxy_pass http://backend;
}

# æ­£ç¡®å†™æ³•
location /api/ {
    proxy_pass http://backend;  # ç›´æ¥ä»£ç†å³å¯
}
```

**âœ… æœ€ä½³å®è·µå»ºè®®**
- é™æ€ç«™ç‚¹ä½¿ç”¨ï¼š`try_files $uri $uri/ =404;`
- SPAåº”ç”¨ä½¿ç”¨ï¼š`try_files $uri $uri/ /index.html;`
- PHPæ¡†æ¶ä½¿ç”¨ï¼š`try_files $uri $uri/ /index.php?$query_string;`
- APIæ¥å£ç›´æ¥ä½¿ç”¨proxy_passï¼Œä¸éœ€è¦try_files

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ serverå—ï¼šè™šæ‹Ÿä¸»æœºçš„é…ç½®å®¹å™¨ï¼Œå¤„ç†ç‰¹å®šåŸŸåå’Œç«¯å£çš„è¯·æ±‚
ğŸ”¸ listenæŒ‡ä»¤ï¼šæŒ‡å®šç›‘å¬çš„IPåœ°å€å’Œç«¯å£ï¼Œæ”¯æŒå¤šç§ç»‘å®šæ–¹å¼
ğŸ”¸ server_nameï¼šåŸŸååŒ¹é…æœºåˆ¶ï¼Œæ”¯æŒç²¾ç¡®ã€é€šé…ç¬¦ã€æ­£åˆ™å¤šç§åŒ¹é…
ğŸ”¸ root vs aliasï¼šæ ¹ç›®å½•è®¾ç½®çš„ä¸¤ç§æ–¹å¼ï¼Œè·¯å¾„æ„å»ºè§„åˆ™ä¸åŒ
ğŸ”¸ locationå—ï¼šURLè·¯å¾„åŒ¹é…å’Œå¤„ç†è§„åˆ™çš„æ ¸å¿ƒé…ç½®
ğŸ”¸ try_filesï¼šæ–‡ä»¶æŸ¥æ‰¾çš„æ™ºèƒ½å›é€€æœºåˆ¶
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ serverå—çš„æœ¬è´¨**
```
æ ¸å¿ƒç†è§£ï¼š
serverå— = è™šæ‹Ÿä¸»æœºé…ç½® = ä¸€ä¸ªç½‘ç«™çš„å®Œæ•´é…ç½®
æ¯ä¸ªserverå—ç‹¬ç«‹å¤„ç†ç‰¹å®šçš„åŸŸåå’Œç«¯å£
å¤šä¸ªserverå—å¯ä»¥å…±å­˜ï¼Œå®ç°ä¸€å°æœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªç½‘ç«™
```

**ğŸ”¹ locationåŒ¹é…çš„ç²¾é«“**
```
åŒ¹é…åŸåˆ™ï¼š
ç²¾ç¡®ä¼˜å…ˆ > å‰ç¼€ä¼˜å…ˆ > æ­£åˆ™é¡ºåº > æœ€é•¿å‰ç¼€
ç†è§£è¿™ä¸ªä¼˜å…ˆçº§é¡ºåºæ˜¯é…ç½®æ­£ç¡®locationçš„å…³é”®
```

**ğŸ”¹ rootä¸aliasçš„ä½¿ç”¨æ—¶æœº**
```
é€‰æ‹©æ ‡å‡†ï¼š
- ç›®å½•ç»“æ„ä¸URLç»“æ„ä¸€è‡´ â†’ ä½¿ç”¨root
- éœ€è¦é‡æ–°æ˜ å°„è·¯å¾„ â†’ ä½¿ç”¨alias
- rootç”¨äºæ•´ä½“é…ç½®ï¼Œaliasç”¨äºç‰¹æ®Šè·¯å¾„å¤„ç†
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é…ç½®ç­–ç•¥å»ºè®®**
```
åŸºç¡€ç­–ç•¥ï¼š
1. ä¸€ä¸ªç½‘ç«™ä¸€ä¸ªserverå—
2. åˆç†ä½¿ç”¨locationå—å¤„ç†ä¸åŒç±»å‹çš„è¯·æ±‚
3. é™æ€èµ„æºã€åŠ¨æ€æ¥å£ã€ç‰¹æ®Šè·¯å¾„åˆ†åˆ«é…ç½®
4. å–„ç”¨try_fileså®ç°ä¼˜é›…çš„å›é€€æœºåˆ¶
```

**ğŸ”§ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
ä¼˜åŒ–é‡ç‚¹ï¼š
- é™æ€èµ„æºè®¾ç½®åˆé€‚çš„ç¼“å­˜ç­–ç•¥
- ä½¿ç”¨ ^~ é¿å…ä¸å¿…è¦çš„æ­£åˆ™åŒ¹é…
- åˆç†è§„åˆ’locationå—çš„é¡ºåº
- é’ˆå¯¹ä¸åŒæ–‡ä»¶ç±»å‹è®¾ç½®ä¸åŒçš„å¤„ç†è§„åˆ™
```

### 9.4 æœ€ä½³å®è·µæ€»ç»“


**âœ… æ¨èé…ç½®æ¨¡å¼**
```nginx
# æ ‡å‡†çš„serverå—é…ç½®æ¨¡æ¿
server {
    # åŸºç¡€è®¾ç½®
    listen 80;
    listen [::]:80;
    server_name example.com www.example.com;
    root /var/www/example;
    index index.html index.php;
    
    # ç²¾ç¡®åŒ¹é…é¦–é¡µ
    location = / {
        try_files /index.html =404;
    }
    
    # é™æ€èµ„æºä¼˜å…ˆåŒ¹é…
    location ^~ /static/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # åŠ¨æ€å¤„ç†
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php-fpm.sock;
        include fastcgi_params;
    }
    
    # é»˜è®¤å¤„ç†
    location / {
        try_files $uri $uri/ =404;
    }
}
```

**âš ï¸ é…ç½®æ³¨æ„äº‹é¡¹**
- server_nameæ”¯æŒå¤šç§åŒ¹é…æ–¹å¼ï¼Œåˆç†é€‰æ‹©æé«˜æ€§èƒ½
- locationå—çš„é¡ºåºå¾ˆé‡è¦ï¼Œç‰¹åˆ«æ˜¯æ­£åˆ™åŒ¹é…
- try_fileså¿…é¡»æœ‰æœ€åçš„å¤‡é€‰æ–¹æ¡ˆ
- rootå’Œaliasçš„è·¯å¾„æ‹¼æ¥è§„åˆ™è¦ç†è§£æ¸…æ¥š

**ğŸ“ å­¦ä¹ è¿›é˜¶å»ºè®®**
- é€šè¿‡å®é™…é…ç½®éªŒè¯ç†è®ºçŸ¥è¯†
- ä½¿ç”¨nginx -tæ£€æŸ¥é…ç½®è¯­æ³•
- æŸ¥çœ‹access.logå’Œerror.logæ’æŸ¥é—®é¢˜
- æŒæ¡ä¸åŒåº”ç”¨ç±»å‹çš„å…¸å‹é…ç½®æ¨¡å¼

**æ ¸å¿ƒè®°å¿†**ï¼š
- serverå—æ˜¯è™šæ‹Ÿä¸»æœºï¼Œlocationå—æ˜¯è·¯å¾„å¤„ç†
- åŒ¹é…ä¼˜å…ˆçº§ï¼šç²¾ç¡®>å‰ç¼€ä¼˜å…ˆ>æ­£åˆ™>æ™®é€šå‰ç¼€
- rootæ‹¼æ¥å®Œæ•´è·¯å¾„ï¼Œaliasæ›¿æ¢åŒ¹é…éƒ¨åˆ†
- try_filesæä¾›æ™ºèƒ½çš„æ–‡ä»¶æŸ¥æ‰¾å›é€€æœºåˆ¶