---
title: 3ã€Apacheè™šæ‹Ÿä¸»æœºé…ç½®
---
## ğŸ“š ç›®å½•

1. [è™šæ‹Ÿä¸»æœºåŸºæœ¬æ¦‚å¿µ](#1-è™šæ‹Ÿä¸»æœºåŸºæœ¬æ¦‚å¿µ)
2. [åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº](#2-åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº)
3. [åŸºäºIPçš„è™šæ‹Ÿä¸»æœº](#3-åŸºäºIPçš„è™šæ‹Ÿä¸»æœº)
4. [åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº](#4-åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº)
5. [è™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§ä¸é»˜è®¤è®¾ç½®](#5-è™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§ä¸é»˜è®¤è®¾ç½®)
6. [æ—¥å¿—ç®¡ç†ä¸æ•…éšœæ’æŸ¥](#6-æ—¥å¿—ç®¡ç†ä¸æ•…éšœæ’æŸ¥)
7. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#7-å®æˆ˜é…ç½®æ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ è™šæ‹Ÿä¸»æœºåŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è™šæ‹Ÿä¸»æœº


ğŸ’­ **ç®€å•ç†è§£**ï¼šè™šæ‹Ÿä¸»æœºå°±åƒåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå¼€äº†å¤šä¸ª"é—¨é¢æˆ¿"ï¼Œæ¯ä¸ªç½‘ç«™éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„"åº—é“º"ï¼Œä½†å®é™…ä¸Šéƒ½åœ¨åŒä¸€æ ‹"å¤§æ¥¼"é‡Œã€‚

ğŸ” **æŠ€æœ¯å®šä¹‰**ï¼š
- **è™šæ‹Ÿä¸»æœº** = åœ¨å•ä¸ªApacheæœåŠ¡å™¨ä¸Šæ‰˜ç®¡å¤šä¸ªç½‘ç«™çš„æŠ€æœ¯
- **æ ¸å¿ƒä½œç”¨** = èµ„æºå…±äº«ï¼Œæˆæœ¬é™ä½ï¼Œç®¡ç†é›†ä¸­
- **å®ç°åŸç†** = é€šè¿‡ä¸åŒçš„æ ‡è¯†ç¬¦ï¼ˆåŸŸå/IP/ç«¯å£ï¼‰åŒºåˆ†ä¸åŒç½‘ç«™

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿä¸»æœº


ğŸ¤” **ç°å®åœºæ™¯**ï¼š
- ä¸€å°æœåŠ¡å™¨ç¡¬ä»¶æˆæœ¬é«˜ï¼Œåªè·‘ä¸€ä¸ªç½‘ç«™å¤ªæµªè´¹
- å°ä¼ä¸šéœ€è¦å¤šä¸ªç½‘ç«™ï¼šå®˜ç½‘ã€å•†åŸã€åšå®¢ç­‰
- å¼€å‘ç¯å¢ƒéœ€è¦åŒæ—¶æµ‹è¯•å¤šä¸ªé¡¹ç›®

ğŸ’¡ **è™šæ‹Ÿä¸»æœºçš„ä¼˜åŠ¿**ï¼š
```
èµ„æºåˆ©ç”¨ç‡ï¼šä¸€å°æœåŠ¡å™¨ â†’ å¤šä¸ªç½‘ç«™
æˆæœ¬æ§åˆ¶ï¼šç¡¬ä»¶æˆæœ¬ Ã· ç½‘ç«™æ•°é‡
ç®¡ç†ä¾¿åˆ©ï¼šç»Ÿä¸€æœåŠ¡å™¨ â†’ ç»Ÿä¸€ç»´æŠ¤
çµæ´»æ‰©å±•ï¼šæ–°å¢ç½‘ç«™ = æ–°å¢é…ç½®
```

### 1.3 è™šæ‹Ÿä¸»æœºåˆ†ç±»æ¦‚è§ˆ


ğŸ“Š **ä¸‰ç§ä¸»è¦ç±»å‹**ï¼š

| **ç±»å‹** | **åŒºåˆ†æ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **é…ç½®å¤æ‚åº¦** |
|---------|-------------|-------------|---------------|
| ğŸŒŸ **åŸºäºåŸŸå** | `ä¸åŒåŸŸå` | `æœ€å¸¸ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒé¦–é€‰` | `ç®€å•` |
| ğŸ”¢ **åŸºäºIP** | `ä¸åŒIPåœ°å€` | `å®‰å…¨è¦æ±‚é«˜ï¼Œç‹¬ç«‹SSL` | `ä¸­ç­‰` |
| ğŸšª **åŸºäºç«¯å£** | `ä¸åŒç«¯å£å·` | `å¼€å‘æµ‹è¯•ï¼Œå†…éƒ¨åº”ç”¨` | `ç®€å•` |

---

## 2. ğŸŒŸ åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº


### 2.1 åŸºæœ¬å·¥ä½œåŸç†


ğŸ” **å·¥ä½œæµç¨‹**ï¼š
```
ç”¨æˆ·è®¿é—® www.example.com
    â†“
æµè§ˆå™¨å‘é€HTTPè¯·æ±‚å¤´ï¼šHost: www.example.com
    â†“
Apacheæ ¹æ®Hostå¤´åŒ¹é…å¯¹åº”çš„VirtualHosté…ç½®
    â†“
è¿”å›å¯¹åº”ç½‘ç«™çš„å†…å®¹
```

ğŸ’­ **ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**ï¼šHTTP/1.1åè®®æ”¯æŒåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦åŸŸåä¿¡æ¯ï¼Œè®©æœåŠ¡å™¨çŸ¥é“ç”¨æˆ·æƒ³è®¿é—®å“ªä¸ªç½‘ç«™ã€‚

### 2.2 NameVirtualHosté…ç½®


ğŸ“ **é…ç½®è¯­æ³•**ï¼š
```apache
# Apache 2.2ç‰ˆæœ¬éœ€è¦æ­¤æŒ‡ä»¤
NameVirtualHost *:80

# Apache 2.4ç‰ˆæœ¬å·²ç»ä¸éœ€è¦æ­¤æŒ‡ä»¤
# ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†
```

âš ï¸ **ç‰ˆæœ¬å·®å¼‚è¯´æ˜**ï¼š
- **Apache 2.2**ï¼šå¿…é¡»å…ˆå£°æ˜`NameVirtualHost`
- **Apache 2.4**ï¼šå·²ç»åºŸå¼ƒï¼Œç›´æ¥é…ç½®VirtualHostå³å¯

### 2.3 VirtualHosté…ç½®è¯¦è§£


ğŸ—ï¸ **åŸºæœ¬é…ç½®ç»“æ„**ï¼š
```apache
<VirtualHost *:80>
    ServerName www.example.com
    ServerAlias example.com
    DocumentRoot /var/www/example
    ErrorLog /var/log/apache2/example.com_error.log
    CustomLog /var/log/apache2/example.com_access.log combined
</VirtualHost>
```

ğŸ”§ **å…³é”®æŒ‡ä»¤è§£é‡Š**ï¼š

**ServerName**ï¼š
- ğŸ·ï¸ **ä½œç”¨**ï¼šä¸»åŸŸåï¼ŒApacheç”¨æ¥åŒ¹é…è¯·æ±‚
- ğŸ“‹ **è¯­æ³•**ï¼š`ServerName åŸŸå`
- ğŸ’¡ **ç†è§£**ï¼šå°±åƒé—¨ç‰Œå·ï¼Œå‘Šè¯‰Apacheè¿™ä¸ªè™šæ‹Ÿä¸»æœºçš„"æ­£å¼åœ°å€"

**ServerAlias**ï¼š
- ğŸ·ï¸ **ä½œç”¨**ï¼šåˆ«ååŸŸåï¼Œå¤šä¸ªåŸŸåæŒ‡å‘åŒä¸€ç½‘ç«™
- ğŸ“‹ **è¯­æ³•**ï¼š`ServerAlias åŸŸå1 åŸŸå2 åŸŸå3`
- ğŸŒ° **ä¾‹å­**ï¼š`example.com`å’Œ`www.example.com`éƒ½è®¿é—®åŒä¸€ç½‘ç«™

**DocumentRoot**ï¼š
- ğŸ·ï¸ **ä½œç”¨**ï¼šç½‘ç«™æ–‡ä»¶å­˜æ”¾çš„æ ¹ç›®å½•
- ğŸ“‹ **è¯­æ³•**ï¼š`DocumentRoot /è·¯å¾„/åˆ°/ç½‘ç«™/æ–‡ä»¶`
- ğŸ” **ç†è§£**ï¼šç”¨æˆ·è®¿é—®`/`æ—¶ï¼Œå®é™…è®¿é—®çš„å°±æ˜¯è¿™ä¸ªç›®å½•

### 2.4 å®Œæ•´é…ç½®ç¤ºä¾‹


```apache
# ç¬¬ä¸€ä¸ªç½‘ç«™ï¼šå…¬å¸å®˜ç½‘
<VirtualHost *:80>
    ServerName www.company.com
    ServerAlias company.com
    DocumentRoot /var/www/company
    
    # ç›®å½•æƒé™é…ç½®
    <Directory /var/www/company>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # æ—¥å¿—æ–‡ä»¶é…ç½®
    ErrorLog /var/log/apache2/company_error.log
    CustomLog /var/log/apache2/company_access.log combined
</VirtualHost>

# ç¬¬äºŒä¸ªç½‘ç«™ï¼šåœ¨çº¿å•†åŸ
<VirtualHost *:80>
    ServerName shop.company.com
    DocumentRoot /var/www/shop
    
    <Directory /var/www/shop>
        Options -Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog /var/log/apache2/shop_error.log
    CustomLog /var/log/apache2/shop_access.log combined
</VirtualHost>
```

---

## 3. ğŸ”¢ åŸºäºIPçš„è™šæ‹Ÿä¸»æœº


### 3.1 ä»€ä¹ˆæ˜¯åŸºäºIPçš„è™šæ‹Ÿä¸»æœº


ğŸ’­ **ç®€å•ç†è§£**ï¼šæ¯ä¸ªç½‘ç«™éƒ½æœ‰è‡ªå·±ä¸“ç”¨çš„IPåœ°å€ï¼Œå°±åƒæ¯ä¸ªé—¨é¢æˆ¿éƒ½æœ‰ç‹¬ç«‹çš„é—¨ç‰Œå·ç ã€‚

ğŸ” **é€‚ç”¨åœºæ™¯**ï¼š
- **SSLè¯ä¹¦éœ€æ±‚**ï¼šä¸åŒç½‘ç«™éœ€è¦ä¸åŒçš„SSLè¯ä¹¦
- **å®‰å…¨éš”ç¦»**ï¼šç½‘ç«™é—´éœ€è¦ç½‘ç»œå±‚é¢çš„å®Œå…¨éš”ç¦»
- **ç‰¹æ®Šåº”ç”¨**ï¼šæŸäº›åº”ç”¨è¦æ±‚ç‹¬å IP

### 3.2 IPåœ°å€é…ç½®


ğŸ”§ **ç³»ç»Ÿç½‘ç»œé…ç½®**ï¼š
```bash
# ä¸ºç½‘å¡æ·»åŠ å¤šä¸ªIPåœ°å€
sudo ip addr add 192.168.1.100/24 dev eth0
sudo ip addr add 192.168.1.101/24 dev eth0

# æ°¸ä¹…é…ç½®ï¼ˆUbuntu/Debianï¼‰
# ç¼–è¾‘ /etc/netplan/01-network-manager-all.yaml
```

ğŸ“ **è™šæ‹Ÿä¸»æœºé…ç½®**ï¼š
```apache
# ç¬¬ä¸€ä¸ªIPçš„ç½‘ç«™
<VirtualHost 192.168.1.100:80>
    ServerName site1.example.com
    DocumentRoot /var/www/site1
    ErrorLog /var/log/apache2/site1_error.log
    CustomLog /var/log/apache2/site1_access.log combined
</VirtualHost>

# ç¬¬äºŒä¸ªIPçš„ç½‘ç«™
<VirtualHost 192.168.1.101:80>
    ServerName site2.example.com
    DocumentRoot /var/www/site2
    ErrorLog /var/log/apache2/site2_error.log
    CustomLog /var/log/apache2/site2_access.log combined
</VirtualHost>
```

### 3.3 ä¼˜ç¼ºç‚¹åˆ†æ


âœ… **ä¼˜åŠ¿**ï¼š
- **ç‹¬ç«‹æ€§å¼º**ï¼šæ¯ä¸ªç½‘ç«™å®Œå…¨ç‹¬ç«‹
- **SSLæ”¯æŒå¥½**ï¼šæ¯ä¸ªIPå¯ä»¥ç»‘å®šä¸åŒSSLè¯ä¹¦
- **å®‰å…¨æ€§é«˜**ï¼šç½‘ç»œå±‚é¢éš”ç¦»

âŒ **åŠ£åŠ¿**ï¼š
- **IPèµ„æºæ¶ˆè€—**ï¼šæ¯ä¸ªç½‘ç«™éœ€è¦ç‹¬ç«‹IP
- **æˆæœ¬è¾ƒé«˜**ï¼šå…¬ç½‘IPåœ°å€æˆæœ¬é«˜
- **é…ç½®å¤æ‚**ï¼šéœ€è¦é…ç½®å¤šä¸ªç½‘ç»œæ¥å£

---

## 4. ğŸšª åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº


### 4.1 åŸºæœ¬æ¦‚å¿µ


ğŸ’­ **ç®€å•ç†è§£**ï¼šåŒä¸€ä¸ªIPåœ°å€å¼€å¤šä¸ª"é—¨"ï¼Œæ¯ä¸ªé—¨å¯¹åº”ä¸€ä¸ªç½‘ç«™ï¼Œç”¨ç«¯å£å·åŒºåˆ†ã€‚

ğŸ” **å…¸å‹åº”ç”¨**ï¼š
- **å¼€å‘ç¯å¢ƒ**ï¼šæœ¬åœ°æµ‹è¯•å¤šä¸ªé¡¹ç›®
- **å†…éƒ¨åº”ç”¨**ï¼šä¼ä¸šå†…éƒ¨ä¸åŒç³»ç»Ÿ
- **ç‰¹æ®ŠæœåŠ¡**ï¼šéœ€è¦éæ ‡å‡†ç«¯å£çš„åº”ç”¨

### 4.2 ç«¯å£ç›‘å¬é…ç½®


ğŸ“ **Apacheä¸»é…ç½®**ï¼š
```apache
# /etc/apache2/ports.conf
Listen 80
Listen 8080
Listen 8081
Listen 8082
```

ğŸ”§ **è™šæ‹Ÿä¸»æœºé…ç½®**ï¼š
```apache
# é»˜è®¤80ç«¯å£ç½‘ç«™
<VirtualHost *:80>
    ServerName www.example.com
    DocumentRoot /var/www/main
    ErrorLog /var/log/apache2/main_error.log
    CustomLog /var/log/apache2/main_access.log combined
</VirtualHost>

# 8080ç«¯å£çš„æµ‹è¯•ç½‘ç«™
<VirtualHost *:8080>
    ServerName test.example.com
    DocumentRoot /var/www/test
    ErrorLog /var/log/apache2/test_error.log
    CustomLog /var/log/apache2/test_access.log combined
</VirtualHost>

# 8081ç«¯å£çš„ç®¡ç†åå°
<VirtualHost *:8081>
    ServerName admin.example.com
    DocumentRoot /var/www/admin
    
    # è®¿é—®æ§åˆ¶
    <Directory /var/www/admin>
        Require ip 192.168.1.0/24
        Require ip 127.0.0.1
    </Directory>
    
    ErrorLog /var/log/apache2/admin_error.log
    CustomLog /var/log/apache2/admin_access.log combined
</VirtualHost>
```

### 4.3 è®¿é—®æ–¹å¼


ğŸŒ **ç”¨æˆ·è®¿é—®**ï¼š
```
ä¸»ç½‘ç«™ï¼šhttp://www.example.com       (é»˜è®¤80ç«¯å£)
æµ‹è¯•ç«™ï¼šhttp://test.example.com:8080  (æŒ‡å®š8080ç«¯å£)
ç®¡ç†å°ï¼šhttp://admin.example.com:8081 (æŒ‡å®š8081ç«¯å£)
```

---

## 5. âš–ï¸ è™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§ä¸é»˜è®¤è®¾ç½®


### 5.1 åŒ¹é…ä¼˜å…ˆçº§è§„åˆ™


ğŸ” **ApacheåŒ¹é…é¡ºåº**ï¼š
```
1. ç²¾ç¡®IP + ç«¯å£åŒ¹é…
   â†“
2. ServerNameå®Œå…¨åŒ¹é…
   â†“
3. ServerAliasåŒ¹é…
   â†“
4. ç¬¬ä¸€ä¸ªé…ç½®çš„è™šæ‹Ÿä¸»æœºï¼ˆé»˜è®¤è™šæ‹Ÿä¸»æœºï¼‰
```

ğŸ’¡ **å®é™…ä¾‹å­**ï¼š
```apache
# è¿™ä¸ªä¼šæˆä¸ºé»˜è®¤è™šæ‹Ÿä¸»æœºï¼ˆç¬¬ä¸€ä¸ªé…ç½®çš„ï¼‰
<VirtualHost *:80>
    ServerName default.example.com
    DocumentRoot /var/www/default
</VirtualHost>

<VirtualHost *:80>
    ServerName www.example.com
    DocumentRoot /var/www/main
</VirtualHost>
```

### 5.2 é»˜è®¤è™šæ‹Ÿä¸»æœºè®¾ç½®


ğŸ¯ **é»˜è®¤è™šæ‹Ÿä¸»æœºçš„ä½œç”¨**ï¼š
- å½“ç”¨æˆ·è®¿é—®æœªé…ç½®çš„åŸŸåæ—¶ï¼Œæ˜¾ç¤ºé»˜è®¤å†…å®¹
- é˜²æ­¢æ¶æ„åŸŸåæŒ‡å‘æ˜¾ç¤ºå…¶ä»–ç½‘ç«™å†…å®¹
- æä¾›ç»Ÿä¸€çš„é”™è¯¯é¡µé¢

ğŸ“ **å®‰å…¨çš„é»˜è®¤é…ç½®**ï¼š
```apache
# å®‰å…¨çš„é»˜è®¤è™šæ‹Ÿä¸»æœº
<VirtualHost *:80>
    ServerName _default_
    DocumentRoot /var/www/default
    
    # è¿”å›403ç¦æ­¢è®¿é—®
    <Directory /var/www/default>
        Require all denied
    </Directory>
    
    # æˆ–è€…é‡å®šå‘åˆ°ä¸»ç«™
    RedirectMatch 301 ^(.*)$ http://www.example.com$1
    
    ErrorLog /var/log/apache2/default_error.log
    CustomLog /var/log/apache2/default_access.log combined
</VirtualHost>
```

### 5.3 é…ç½®æ–‡ä»¶åŠ è½½é¡ºåº


ğŸ“‚ **æ–‡ä»¶ç»„ç»‡ç»“æ„**ï¼š
```
/etc/apache2/
â”œâ”€â”€ sites-available/          # å¯ç”¨ç«™ç‚¹é…ç½®
â”‚   â”œâ”€â”€ 000-default.conf     # é»˜è®¤ç«™ç‚¹
â”‚   â”œâ”€â”€ example.com.conf     # è‡ªå®šä¹‰ç«™ç‚¹
â”‚   â””â”€â”€ shop.com.conf        # å•†åŸç«™ç‚¹
â”œâ”€â”€ sites-enabled/            # å¯ç”¨ç«™ç‚¹é…ç½®ï¼ˆè½¯é“¾æ¥ï¼‰
â”‚   â”œâ”€â”€ 000-default.conf -> ../sites-available/000-default.conf
â”‚   â””â”€â”€ example.com.conf -> ../sites-available/example.com.conf
```

ğŸ”§ **ç«™ç‚¹ç®¡ç†å‘½ä»¤**ï¼š
```bash
# å¯ç”¨ç«™ç‚¹
sudo a2ensite example.com.conf

# ç¦ç”¨ç«™ç‚¹
sudo a2dissite example.com.conf

# æµ‹è¯•é…ç½®
sudo apache2ctl configtest

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload apache2
```

---

## 6. ğŸ“Š æ—¥å¿—ç®¡ç†ä¸æ•…éšœæ’æŸ¥


### 6.1 æ—¥å¿—æ–‡ä»¶åˆ†ç¦»


ğŸ·ï¸ **ä¸ºä»€ä¹ˆè¦åˆ†ç¦»æ—¥å¿—**ï¼š
- **é—®é¢˜å®šä½**ï¼šå¿«é€Ÿæ‰¾åˆ°ç‰¹å®šç½‘ç«™çš„é—®é¢˜
- **æ€§èƒ½åˆ†æ**ï¼šåˆ†æå•ä¸ªç½‘ç«™çš„è®¿é—®æƒ…å†µ
- **å®‰å…¨å®¡è®¡**ï¼šè¿½è¸ªç‰¹å®šç½‘ç«™çš„å®‰å…¨äº‹ä»¶
- **ç£ç›˜ç®¡ç†**ï¼šæ§åˆ¶å•ä¸ªç½‘ç«™æ—¥å¿—å¤§å°

ğŸ“ **æ—¥å¿—é…ç½®è¯¦è§£**ï¼š
```apache
<VirtualHost *:80>
    ServerName www.example.com
    DocumentRoot /var/www/example
    
    # é”™è¯¯æ—¥å¿—ï¼šè®°å½•Apacheé”™è¯¯å’ŒPHPé”™è¯¯
    ErrorLog /var/log/apache2/example.com_error.log
    
    # è®¿é—®æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰HTTPè¯·æ±‚
    CustomLog /var/log/apache2/example.com_access.log combined
    
    # ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" custom
    CustomLog /var/log/apache2/example.com_custom.log custom
</VirtualHost>
```

### 6.2 æ—¥å¿—æ ¼å¼è¯´æ˜


ğŸ“‹ **combinedæ—¥å¿—æ ¼å¼è§£è¯»**ï¼š
```
192.168.1.100 - - [17/Sep/2025:15:30:45 +0800] "GET /index.html HTTP/1.1" 200 1234 "https://google.com" "Mozilla/5.0..."

å­—æ®µå«ä¹‰ï¼š
%h = 192.168.1.100     (å®¢æˆ·ç«¯IP)
%l = -                 (è¿œç¨‹ç™»å½•åï¼Œé€šå¸¸ä¸º-)
%u = -                 (è®¤è¯ç”¨æˆ·å)
%t = [æ—¶é—´æˆ³]          (è¯·æ±‚æ—¶é—´)
%r = "è¯·æ±‚è¡Œ"          (HTTPæ–¹æ³• è·¯å¾„ åè®®ç‰ˆæœ¬)
%>s = 200              (å“åº”çŠ¶æ€ç )
%b = 1234              (å“åº”å­—èŠ‚æ•°)
Referer = æ¥æºé¡µé¢
User-agent = æµè§ˆå™¨ä¿¡æ¯
```

### 6.3 æ—¥å¿—è½®è½¬é…ç½®


ğŸ”„ **ä½¿ç”¨logrotateç®¡ç†æ—¥å¿—**ï¼š
```bash
# /etc/logrotate.d/apache2-virtualhosts
/var/log/apache2/*.log {
    daily                    # æ¯å¤©è½®è½¬
    missingok               # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
    rotate 52               # ä¿ç•™52ä¸ªæ–‡ä»¶
    compress                # å‹ç¼©æ—§æ–‡ä»¶
    delaycompress           # å»¶è¿Ÿå‹ç¼©
    notifempty              # ç©ºæ–‡ä»¶ä¸è½®è½¬
    create 640 www-data adm # åˆ›å»ºæ–°æ–‡ä»¶çš„æƒé™
    postrotate
        systemctl reload apache2
    endscript
}
```

### 6.4 å¸¸è§æ•…éšœæ’æŸ¥


ğŸ” **æ•…éšœæ’æŸ¥æµç¨‹**ï¼š

```
é—®é¢˜ç°è±¡ï¼šç½‘ç«™æ— æ³•è®¿é—®
    â†“
æ£€æŸ¥ApacheçŠ¶æ€ï¼šsystemctl status apache2
    â†“
æ£€æŸ¥é…ç½®è¯­æ³•ï¼šapache2ctl configtest
    â†“
æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼štail -f /var/log/apache2/error.log
    â†“
æŸ¥çœ‹è®¿é—®æ—¥å¿—ï¼štail -f /var/log/apache2/access.log
    â†“
æ£€æŸ¥æ–‡ä»¶æƒé™ï¼šls -la /var/www/
```

âš ï¸ **å¸¸è§é—®é¢˜ä¸è§£å†³**ï¼š

| **é—®é¢˜ç°è±¡** | **å¯èƒ½åŸå› ** | **æ’æŸ¥å‘½ä»¤** | **è§£å†³æ–¹æ³•** |
|-------------|-------------|-------------|-------------|
| `403 Forbidden` | `ç›®å½•æƒé™ä¸è¶³` | `ls -la /var/www/` | `chmod 755 ç›®å½•` |
| `500 Internal Error` | `é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯` | `apache2ctl configtest` | `ä¿®å¤è¯­æ³•é”™è¯¯` |
| `åŸŸåè®¿é—®é”™è¯¯ç½‘ç«™` | `è™šæ‹Ÿä¸»æœºé…ç½®é—®é¢˜` | `æ£€æŸ¥ServerNameé…ç½®` | `ä¿®æ­£åŸŸåé…ç½®` |

---

## 7. ğŸ› ï¸ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 7.1 ä¼ä¸šçº§å¤šç«™ç‚¹é…ç½®


ğŸ¢ **åœºæ™¯æè¿°**ï¼šæŸå…¬å¸éœ€è¦é…ç½®ä»¥ä¸‹ç½‘ç«™ï¼š
- å®˜ç½‘ï¼š`www.company.com`
- å•†åŸï¼š`shop.company.com`
- åšå®¢ï¼š`blog.company.com`
- ç®¡ç†åå°ï¼š`admin.company.com`ï¼ˆä»…å†…ç½‘è®¿é—®ï¼‰

ğŸ“ **å®Œæ•´é…ç½®æ–¹æ¡ˆ**ï¼š

**ä¸»é…ç½®æ–‡ä»¶è°ƒæ•´** (`/etc/apache2/apache2.conf`)ï¼š
```apache
# å®‰å…¨è®¾ç½®
ServerTokens Prod
ServerSignature Off

# æ€§èƒ½ä¼˜åŒ–
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5
```

**å®˜ç½‘é…ç½®** (`/etc/apache2/sites-available/company.conf`)ï¼š
```apache
<VirtualHost *:80>
    ServerName www.company.com
    ServerAlias company.com
    DocumentRoot /var/www/company
    
    <Directory /var/www/company>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # å¼ºåˆ¶HTTPSé‡å®šå‘
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    ErrorLog /var/log/apache2/company_error.log
    CustomLog /var/log/apache2/company_access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName www.company.com
    ServerAlias company.com
    DocumentRoot /var/www/company
    
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/company.crt
    SSLCertificateKeyFile /etc/ssl/private/company.key
    
    <Directory /var/www/company>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog /var/log/apache2/company_ssl_error.log
    CustomLog /var/log/apache2/company_ssl_access.log combined
</VirtualHost>
```

**å•†åŸé…ç½®** (`/etc/apache2/sites-available/shop.conf`)ï¼š
```apache
<VirtualHost *:80>
    ServerName shop.company.com
    DocumentRoot /var/www/shop
    
    # å•†åŸç‰¹æ®Šéœ€æ±‚
    <Directory /var/www/shop>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶
        php_value upload_max_filesize 50M
        php_value post_max_size 50M
    </Directory>
    
    # é˜²æ­¢ç›´æ¥è®¿é—®uploadsç›®å½•
    <Directory /var/www/shop/uploads>
        Options -ExecCGI -Indexes
        <Files ~ "\.(php|pl|py|cgi)$">
            Require all denied
        </Files>
    </Directory>
    
    ErrorLog /var/log/apache2/shop_error.log
    CustomLog /var/log/apache2/shop_access.log combined
</VirtualHost>
```

**ç®¡ç†åå°é…ç½®** (`/etc/apache2/sites-available/admin.conf`)ï¼š
```apache
<VirtualHost *:8080>
    ServerName admin.company.com
    DocumentRoot /var/www/admin
    
    # ä»…å…è®¸å†…ç½‘è®¿é—®
    <Directory /var/www/admin>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        
        # IPè®¿é—®æ§åˆ¶
        Require ip 192.168.1.0/24
        Require ip 10.0.0.0/8
        Require ip 127.0.0.1
    </Directory>
    
    # HTTPåŸºæœ¬è®¤è¯
    <Directory /var/www/admin>
        AuthType Basic
        AuthName "Admin Area"
        AuthUserFile /etc/apache2/.htpasswd
        Require valid-user
    </Directory>
    
    ErrorLog /var/log/apache2/admin_error.log
    CustomLog /var/log/apache2/admin_access.log combined
</VirtualHost>
```

### 7.2 å¼€å‘ç¯å¢ƒé…ç½®


ğŸ”§ **å¼€å‘è€…æœ¬åœ°ç¯å¢ƒ**ï¼š
```apache
# æœ¬åœ°å¼€å‘é…ç½®
<VirtualHost *:80>
    ServerName dev.local
    DocumentRoot /home/developer/projects/main
    
    <Directory /home/developer/projects/main>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # PHPå¼€å‘è®¾ç½®
        php_flag display_errors On
        php_value error_reporting E_ALL
    </Directory>
    
    ErrorLog /var/log/apache2/dev_error.log
    CustomLog /var/log/apache2/dev_access.log combined
</VirtualHost>

# APIæµ‹è¯•ç¯å¢ƒ
<VirtualHost *:8080>
    ServerName api.dev.local
    DocumentRoot /home/developer/projects/api
    
    <Directory /home/developer/projects/api>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # CORSè®¾ç½®
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS"
        Header always set Access-Control-Allow-Headers "Content-Type,Authorization"
    </Directory>
</VirtualHost>
```

### 7.3 éƒ¨ç½²è„šæœ¬è‡ªåŠ¨åŒ–


ğŸ¤– **è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬**ï¼š
```bash
#!/bin/bash
# deploy-vhost.sh - è™šæ‹Ÿä¸»æœºéƒ¨ç½²è„šæœ¬

DOMAIN=$1
WEBROOT=$2

if [ -z "$DOMAIN" ] || [ -z "$WEBROOT" ]; then
    echo "ç”¨æ³•: $0 <åŸŸå> <ç½‘ç«™æ ¹ç›®å½•>"
    exit 1
fi

# åˆ›å»ºç½‘ç«™ç›®å½•
sudo mkdir -p $WEBROOT
sudo chown www-data:www-data $WEBROOT
sudo chmod 755 $WEBROOT

# åˆ›å»ºè™šæ‹Ÿä¸»æœºé…ç½®
cat > /tmp/${DOMAIN}.conf << EOF
<VirtualHost *:80>
    ServerName $DOMAIN
    DocumentRoot $WEBROOT
    
    <Directory $WEBROOT>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog /var/log/apache2/${DOMAIN}_error.log
    CustomLog /var/log/apache2/${DOMAIN}_access.log combined
</VirtualHost>
EOF

# ç§»åŠ¨é…ç½®æ–‡ä»¶å¹¶å¯ç”¨
sudo mv /tmp/${DOMAIN}.conf /etc/apache2/sites-available/
sudo a2ensite ${DOMAIN}.conf

# æµ‹è¯•é…ç½®
if sudo apache2ctl configtest; then
    sudo systemctl reload apache2
    echo "âœ… è™šæ‹Ÿä¸»æœº $DOMAIN é…ç½®æˆåŠŸï¼"
else
    echo "âŒ é…ç½®æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¯­æ³•"
    sudo a2dissite ${DOMAIN}.conf
fi
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


ğŸ”¸ **è™šæ‹Ÿä¸»æœºæœ¬è´¨**ï¼šåœ¨å•å°æœåŠ¡å™¨ä¸Šæ‰˜ç®¡å¤šä¸ªç½‘ç«™çš„æŠ€æœ¯
ğŸ”¸ **ä¸‰ç§ç±»å‹**ï¼šåŸºäºåŸŸåï¼ˆæœ€å¸¸ç”¨ï¼‰ã€åŸºäºIPã€åŸºäºç«¯å£
ğŸ”¸ **é…ç½®æ ¸å¿ƒ**ï¼šVirtualHostå— + ServerName + DocumentRoot
ğŸ”¸ **åŒ¹é…é¡ºåº**ï¼šç²¾ç¡®åŒ¹é… â†’ ServerName â†’ ServerAlias â†’ é»˜è®¤
ğŸ”¸ **æ—¥å¿—åˆ†ç¦»**ï¼šæ¯ä¸ªè™šæ‹Ÿä¸»æœºç‹¬ç«‹çš„é”™è¯¯å’Œè®¿é—®æ—¥å¿—

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆåŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœºæœ€å¸¸ç”¨**ï¼š
- **èµ„æºæ•ˆç‡**ï¼šä¸€ä¸ªIPæ‰¿è½½å¤šä¸ªç½‘ç«™
- **æˆæœ¬æ§åˆ¶**ï¼šæ— éœ€ä¸ºæ¯ä¸ªç½‘ç«™é…ç½®ç‹¬ç«‹IP
- **é…ç½®ç®€å•**ï¼šåªéœ€è¦DNSè§£æåˆ°åŒä¸€IP
- **æ‰©å±•æ€§å¥½**ï¼šæ–°å¢ç½‘ç«™åªéœ€æ–°å¢é…ç½®

**ğŸ”¹ é…ç½®æ–‡ä»¶çš„ç»„ç»‡æ–¹å¼**ï¼š
- **sites-available**ï¼šå­˜æ”¾æ‰€æœ‰å¯ç”¨é…ç½®
- **sites-enabled**ï¼šå­˜æ”¾å½“å‰å¯ç”¨é…ç½®çš„è½¯é“¾æ¥
- **æ¨¡å—åŒ–ç®¡ç†**ï¼šæ¯ä¸ªç½‘ç«™ç‹¬ç«‹é…ç½®æ–‡ä»¶
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šä¾¿äºé…ç½®çš„å¤‡ä»½å’Œå›æ»š

**ğŸ”¹ å®‰å…¨æœ€ä½³å®è·µ**ï¼š
- **é»˜è®¤è™šæ‹Ÿä¸»æœº**ï¼šè®¾ç½®å®‰å…¨çš„é»˜è®¤å“åº”
- **ç›®å½•æƒé™**ï¼šæ­£ç¡®è®¾ç½®æ–‡ä»¶å’Œç›®å½•æƒé™
- **è®¿é—®æ§åˆ¶**ï¼šç®¡ç†åå°é™åˆ¶IPè®¿é—®
- **æ—¥å¿—ç›‘æ§**ï¼šå®šæœŸæ£€æŸ¥è®¿é—®å’Œé”™è¯¯æ—¥å¿—

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ç”Ÿäº§ç¯å¢ƒåº”ç”¨**ï¼š
- **ä¼ä¸šå®˜ç½‘**ï¼šå¤šå“ç‰Œã€å¤šäº§å“çº¿ç½‘ç«™æ‰˜ç®¡
- **ç”µå•†å¹³å°**ï¼šä¸»ç«™ã€æ‰‹æœºç‰ˆã€ç®¡ç†åå°åˆ†ç¦»
- **å†…å®¹ç®¡ç†**ï¼šç½‘ç«™ã€åšå®¢ã€APIæœåŠ¡ç»Ÿä¸€ç®¡ç†
- **å¼€å‘æµ‹è¯•**ï¼šå¼€å‘ã€æµ‹è¯•ã€é¢„å‘å¸ƒç¯å¢ƒéš”ç¦»

**è¿ç»´ç®¡ç†ä¼˜åŠ¿**ï¼š
- **é›†ä¸­ç®¡ç†**ï¼šç»Ÿä¸€çš„æœåŠ¡å™¨ç»´æŠ¤å’Œç›‘æ§
- **èµ„æºå…±äº«**ï¼šç¡¬ä»¶èµ„æºæœ€å¤§åŒ–åˆ©ç”¨
- **å¿«é€Ÿéƒ¨ç½²**ï¼šæ–°ç½‘ç«™å¿«é€Ÿä¸Šçº¿
- **æ•…éšœéš”ç¦»**ï¼šå•ä¸ªç½‘ç«™é—®é¢˜ä¸å½±å“å…¶ä»–ç½‘ç«™

**æˆæœ¬æ•ˆç›Š**ï¼š
- **ç¡¬ä»¶æˆæœ¬**ï¼šä¸€å°æœåŠ¡å™¨æ”¯æ’‘å¤šä¸ªç½‘ç«™
- **è¿ç»´æˆæœ¬**ï¼šç»Ÿä¸€çš„ç®¡ç†å’Œç»´æŠ¤æµç¨‹
- **æ‰©å±•æˆæœ¬**ï¼šæ–°å¢ç½‘ç«™è¾¹é™…æˆæœ¬å¾ˆä½

### 8.4 å­¦ä¹ å»ºè®®


**ğŸ¯ æŒæ¡æ­¥éª¤**ï¼š
1. **ç†è§£æ¦‚å¿µ**ï¼šå…ˆç†è§£è™šæ‹Ÿä¸»æœºè§£å†³ä»€ä¹ˆé—®é¢˜
2. **åŠ¨æ‰‹å®è·µ**ï¼šåœ¨æœ¬åœ°ç¯å¢ƒé…ç½®åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº
3. **ç†Ÿæ‚‰è¯­æ³•**ï¼šæŒæ¡VirtualHosté…ç½®è¯­æ³•å’Œå…³é”®æŒ‡ä»¤
4. **è§£å†³é—®é¢˜**ï¼šå­¦ä¼šæŸ¥çœ‹æ—¥å¿—å’Œæ’æŸ¥å¸¸è§æ•…éšœ
5. **ä¼˜åŒ–é…ç½®**ï¼šäº†è§£å®‰å…¨å’Œæ€§èƒ½ä¼˜åŒ–é…ç½®

**ğŸ’¡ å¸¸è§è¯¯åŒºæé†’**ï¼š
- âŒ å¿˜è®°é…ç½®DNSè§£æå¯¼è‡´åŸŸåæ— æ³•è®¿é—®
- âŒ ç›®å½•æƒé™è®¾ç½®é”™è¯¯å¯¼è‡´403é”™è¯¯
- âŒ é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯å¯¼è‡´Apacheå¯åŠ¨å¤±è´¥
- âŒ æ—¥å¿—æ–‡ä»¶è·¯å¾„é”™è¯¯å¯¼è‡´æ— æ³•è®°å½•æ—¥å¿—

**æ ¸å¿ƒè®°å¿†**ï¼š
- è™šæ‹Ÿä¸»æœºè®©ä¸€å°æœåŠ¡å™¨å˜èº«å¤šé¢æ‰‹
- åŸºäºåŸŸåçš„é…ç½®æœ€å®ç”¨æœ€å¸¸è§
- VirtualHost + ServerName + DocumentRoot æ˜¯æ ¸å¿ƒä¸‰è¦ç´ 
- æ—¥å¿—åˆ†ç¦»è®©é—®é¢˜æ’æŸ¥æ›´ç²¾å‡†