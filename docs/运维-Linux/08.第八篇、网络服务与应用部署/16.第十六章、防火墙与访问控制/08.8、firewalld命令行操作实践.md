---
title: 8、firewalld命令行操作实践
---
## 📚 目录

1. [firewall-cmd基础语法](#1-firewall-cmd基础语法)
2. [区域管理操作](#2-区域管理操作)
3. [服务管理实战](#3-服务管理实战)
4. [端口管理操作](#4-端口管理操作)
5. [源地址白名单管理](#5-源地址白名单管理)
6. [配置管理与状态查询](#6-配置管理与状态查询)
7. [紧急模式与安全设置](#7-紧急模式与安全设置)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🛠️ firewall-cmd基础语法


### 1.1 命令基本结构


**firewall-cmd** 是 firewalld 防火墙的命令行管理工具，就像是防火墙的"遥控器"。

```
基本语法结构：
firewall-cmd [选项] [参数]

常用选项组合：
--permanent    永久保存配置（重启后仍有效）
--reload       重新加载配置
--zone=名称    指定操作的区域
--timeout=秒   设置临时规则的超时时间
```

**🔸 理解永久与临时配置**
```
临时配置（当前运行）：
• 立即生效，但重启后丢失
• 用于测试和临时需求
• 命令：firewall-cmd --add-service=ssh

永久配置（持久保存）：
• 需要重载才生效，但重启后保留
• 用于正式的安全策略
• 命令：firewall-cmd --permanent --add-service=ssh
```

### 1.2 获取帮助信息


```bash
# 查看命令帮助
firewall-cmd --help

# 查看版本信息
firewall-cmd --version

# 查看所有可用选项
firewall-cmd --help | grep -E "^\s*--"
```

### 1.3 基础状态检查


```bash
# 检查防火墙是否运行
firewall-cmd --state
# 输出：running 或 not running

# 检查防火墙服务状态
systemctl status firewalld

# 启动防火墙服务
systemctl start firewalld

# 开机自启动防火墙
systemctl enable firewalld
```

---

## 2. 🌐 区域管理操作


### 2.1 理解防火墙区域概念


**区域（Zone）** 是firewalld中的核心概念，就像把网络环境分成不同的"安全等级区域"。

```
常见区域类型：
┌─────────────┬─────────────┬─────────────────┐
│    区域     │   安全级别   │     适用场景     │
├─────────────┼─────────────┼─────────────────┤
│   drop      │   最严格     │  丢弃所有连接    │
│   block     │   很严格     │  拒绝所有连接    │
│   public    │   较严格     │  公共网络环境    │
│   work      │   中等      │  办公网络环境    │
│   home      │   较宽松     │  家庭网络环境    │
│   trusted   │   最宽松     │  完全信任网络    │
└─────────────┴─────────────┴─────────────────┘
```

### 2.2 区域查看操作


```bash
# 查看所有可用区域
firewall-cmd --get-zones

# 查看默认区域
firewall-cmd --get-default-zone

# 查看当前活跃区域
firewall-cmd --get-active-zones

# 查看指定网卡所属区域
firewall-cmd --get-zone-of-interface=eth0
```

**💡 实际操作示例**
```bash
# 查看当前系统的区域配置
[root@server ~]# firewall-cmd --get-active-zones
public
  interfaces: eth0 eth1
  
# 这表示 eth0 和 eth1 网卡都在 public 区域中
```

### 2.3 区域切换与配置


```bash
# 查看区域详细配置
firewall-cmd --zone=public --list-all

# 将网卡分配到指定区域（临时）
firewall-cmd --zone=home --change-interface=eth0

# 将网卡分配到指定区域（永久）
firewall-cmd --permanent --zone=home --change-interface=eth0

# 设置默认区域
firewall-cmd --set-default-zone=public
```

**🔸 区域切换的实际意义**
```
场景理解：
家庭环境 → 使用 home 区域（更宽松的规则）
公司环境 → 使用 work 区域（适中的安全策略）  
公共WiFi → 使用 public 区域（严格的安全控制）
服务器环境 → 使用 public 区域（保守的安全策略）
```

---

## 3. 🔧 服务管理实战


### 3.1 理解防火墙服务


**防火墙服务** 是预定义的应用程序访问规则集合。比如 `ssh` 服务就包含了SSH连接需要的端口和协议规则。

```
服务 vs 端口的关系：
服务名称        实际端口       协议
ssh       →    22/tcp     →  SSH远程登录
http      →    80/tcp     →  网页服务
https     →    443/tcp    →  加密网页服务
ftp       →    21/tcp     →  文件传输
```

### 3.2 服务查询操作


```bash
# 查看所有可用服务
firewall-cmd --get-services

# 查看当前区域允许的服务
firewall-cmd --list-services

# 查看指定区域允许的服务
firewall-cmd --zone=public --list-services

# 检查特定服务是否已启用
firewall-cmd --query-service=ssh
# 返回：yes 或 no
```

### 3.3 服务添加与删除


```bash
# 临时添加服务（立即生效，重启后失效）
firewall-cmd --add-service=http

# 永久添加服务（需要重载，重启后保留）
firewall-cmd --permanent --add-service=http

# 为指定区域添加服务
firewall-cmd --zone=public --add-service=https

# 删除服务（临时）
firewall-cmd --remove-service=ftp

# 删除服务（永久）
firewall-cmd --permanent --remove-service=ftp
```

**📝 实际应用示例**
```bash
# 场景：部署Web服务器，需要开放HTTP和HTTPS访问
# 步骤1：添加HTTP服务
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https

# 步骤2：重载配置使其生效
firewall-cmd --reload

# 步骤3：验证配置
firewall-cmd --list-services
# 输出应该包含：dhcpv6-client http https ssh
```

### 3.4 临时服务规则


```bash
# 添加临时服务（10分钟后自动移除）
firewall-cmd --add-service=http --timeout=600

# 查看带超时的规则
firewall-cmd --list-all
```

---

## 4. 🚪 端口管理操作


### 4.1 端口与服务的区别


虽然服务管理更方便，但有时我们需要直接管理端口：

```
使用服务的场景：
• 标准应用（如SSH、HTTP、FTP）
• 系统预定义的服务规则
• 推荐的管理方式

使用端口的场景：
• 自定义应用端口
• 非标准端口的标准服务
• 需要精确控制的场景
```

### 4.2 端口查询操作


```bash
# 查看当前开放的端口
firewall-cmd --list-ports

# 查看指定区域的开放端口
firewall-cmd --zone=public --list-ports

# 检查特定端口是否开放
firewall-cmd --query-port=8080/tcp
```

### 4.3 端口开放与关闭


```bash
# 开放TCP端口（临时）
firewall-cmd --add-port=8080/tcp

# 开放TCP端口（永久）
firewall-cmd --permanent --add-port=8080/tcp

# 开放UDP端口
firewall-cmd --permanent --add-port=53/udp

# 开放端口范围
firewall-cmd --permanent --add-port=6000-6010/tcp

# 关闭端口（临时）
firewall-cmd --remove-port=8080/tcp

# 关闭端口（永久）
firewall-cmd --permanent --remove-port=8080/tcp
```

**🔸 端口管理实用技巧**
```bash
# 同时开放多个端口
firewall-cmd --permanent --add-port={80/tcp,443/tcp,8080/tcp}

# 为特定区域开放端口
firewall-cmd --zone=work --permanent --add-port=3306/tcp

# 临时开放端口（1小时后自动关闭）
firewall-cmd --add-port=8080/tcp --timeout=3600
```

### 4.4 常用端口管理示例


```bash
# Web服务器端口配置
firewall-cmd --permanent --add-port=80/tcp    # HTTP
firewall-cmd --permanent --add-port=443/tcp   # HTTPS
firewall-cmd --permanent --add-port=8080/tcp  # 备用HTTP

# 数据库端口配置
firewall-cmd --permanent --add-port=3306/tcp  # MySQL
firewall-cmd --permanent --add-port=5432/tcp  # PostgreSQL
firewall-cmd --permanent --add-port=27017/tcp # MongoDB

# 重载配置
firewall-cmd --reload
```

---

## 5. 🏠 源地址白名单管理


### 5.1 理解源地址控制


**源地址控制** 就是指定哪些IP地址或网段可以访问我们的服务器，这是一种很有效的安全防护手段。

```
应用场景：
• 只允许公司内网访问管理端口
• 允许特定客户端访问数据库
• 限制SSH登录的来源IP
• 为VIP用户开放特殊服务
```

### 5.2 源地址查询操作


```bash
# 查看当前允许的源地址
firewall-cmd --list-sources

# 查看指定区域的源地址
firewall-cmd --zone=trusted --list-sources

# 检查特定源地址是否被允许
firewall-cmd --query-source=192.168.1.100
```

### 5.3 添加与删除源地址


```bash
# 添加单个IP地址（临时）
firewall-cmd --add-source=192.168.1.100

# 添加单个IP地址（永久）
firewall-cmd --permanent --add-source=192.168.1.100

# 添加IP段（永久）
firewall-cmd --permanent --add-source=192.168.1.0/24

# 为指定区域添加源地址
firewall-cmd --zone=trusted --permanent --add-source=10.0.0.0/8

# 删除源地址（临时）
firewall-cmd --remove-source=192.168.1.100

# 删除源地址（永久）
firewall-cmd --permanent --remove-source=192.168.1.100
```

### 5.4 实际应用场景


**🔸 场景1：限制SSH访问**
```bash
# 只允许管理员网段SSH登录
firewall-cmd --zone=public --permanent --remove-service=ssh
firewall-cmd --zone=trusted --permanent --add-service=ssh
firewall-cmd --zone=trusted --permanent --add-source=192.168.100.0/24
firewall-cmd --reload
```

**🔸 场景2：数据库访问控制**
```bash
# 只允许应用服务器访问数据库
firewall-cmd --permanent --add-port=3306/tcp --zone=trusted
firewall-cmd --permanent --add-source=192.168.1.10 --zone=trusted
firewall-cmd --permanent --add-source=192.168.1.11 --zone=trusted
firewall-cmd --reload
```

### 5.5 源地址与区域配合使用


```bash
# 查看源地址所属区域
firewall-cmd --get-zone-of-source=192.168.1.100

# 将源地址移动到不同区域
firewall-cmd --zone=work --change-source=192.168.1.0/24

# 查看完整的区域配置（包含源地址）
firewall-cmd --zone=trusted --list-all
```

---

## 6. ⚙️ 配置管理与状态查询


### 6.1 配置重载操作


配置重载是让永久配置生效的关键步骤，就像"保存并应用"设置。

```bash
# 重载防火墙配置
firewall-cmd --reload

# 完全重启防火墙服务（更彻底的重载）
firewall-cmd --complete-reload

# 重载后检查状态
firewall-cmd --state
```

**⚠️ 重载配置的注意事项**
```
重载时机：
• 添加永久规则后
• 修改配置文件后  
• 批量操作完成后

重载影响：
• 临时规则会丢失
• 永久规则开始生效
• 可能短暂中断连接
```

### 6.2 全面状态查询


```bash
# 查看当前区域的完整配置
firewall-cmd --list-all

# 查看所有区域的配置
firewall-cmd --list-all-zones

# 查看指定区域的详细信息
firewall-cmd --zone=public --list-all
```

**输出信息解读**
```bash
# 示例输出：
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: eth0
  sources: 
  services: dhcpv6-client http https ssh
  ports: 8080/tcp
  protocols: 
  masquerade: no
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules:

# 各字段含义：
interfaces: 绑定的网络接口
sources: 允许的源地址
services: 允许的服务
ports: 开放的端口
```

### 6.3 配置备份与恢复


```bash
# 查看配置文件位置
ls /etc/firewalld/zones/

# 备份当前配置
cp -r /etc/firewalld/ /etc/firewalld.backup

# 导出当前规则（可读格式）
firewall-cmd --list-all-zones > firewall_rules.txt
```

### 6.4 运行时与永久配置对比


```bash
# 查看运行时配置
firewall-cmd --list-services

# 查看永久配置
firewall-cmd --permanent --list-services

# 对比两者差异（如果有的话）
diff <(firewall-cmd --list-services) <(firewall-cmd --permanent --list-services)
```

---

## 7. 🚨 紧急模式与安全设置


### 7.1 理解panic模式


**Panic模式** 是防火墙的紧急安全机制，启用后会阻断所有网络连接，相当于"网络急停开关"。

```
Panic模式的特点：
• 阻断所有入站和出站连接
• 只保留本地回环通信
• 用于紧急安全事件响应
• 可能导致远程连接中断
```

### 7.2 panic模式操作


```bash
# 启用panic模式（紧急情况）
firewall-cmd --panic-on

# 查看panic模式状态
firewall-cmd --query-panic
# 返回：yes 或 no

# 关闭panic模式（恢复正常）
firewall-cmd --panic-off
```

**⚠️ Panic模式使用警告**
```
使用场景：
• 检测到恶意攻击时
• 系统出现严重安全问题
• 需要立即切断网络连接

注意事项：
• 会中断当前SSH连接
• 影响所有网络服务
• 需要本地控制台访问来恢复
• 不要在生产环境轻易使用
```

### 7.3 安全操作实践


**🔸 安全检查命令组合**
```bash
# 全面安全状态检查
echo "=== 防火墙状态 ==="
firewall-cmd --state

echo "=== 活跃区域 ==="
firewall-cmd --get-active-zones

echo "=== 开放服务 ==="
firewall-cmd --list-services

echo "=== 开放端口 ==="
firewall-cmd --list-ports

echo "=== 允许源地址 ==="
firewall-cmd --list-sources
```

### 7.4 应急响应脚本


```bash
#!/bin/bash
# 紧急安全响应脚本

# 备份当前配置
firewall-cmd --list-all > /tmp/firewall_backup_$(date +%Y%m%d_%H%M%S).txt

# 切换到严格模式
firewall-cmd --set-default-zone=drop

# 只保留SSH访问（从可信网段）
firewall-cmd --zone=trusted --add-service=ssh
firewall-cmd --zone=trusted --add-source=192.168.1.0/24

# 重载配置
firewall-cmd --reload

echo "紧急安全模式已启用，只允许可信网段SSH访问"
```

### 7.5 日常安全维护


```bash
# 定期检查异常连接
ss -tuln | grep LISTEN

# 查看防火墙日志
journalctl -u firewalld -f

# 检查最近的配置变更
journalctl -u firewalld --since "1 hour ago"

# 验证关键服务状态
firewall-cmd --query-service=ssh
firewall-cmd --query-service=http
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本操作


```
🔸 状态管理：--state, --reload, --list-all
🔸 区域操作：--get-zones, --set-default-zone, --change-interface
🔸 服务管理：--add-service, --remove-service, --list-services  
🔸 端口管理：--add-port, --remove-port, --list-ports
🔸 源地址：--add-source, --remove-source, --list-sources
🔸 配置保存：--permanent, --reload
```

### 8.2 关键理解要点


**🔹 永久与临时配置的区别**
```
临时配置：
• 立即生效，重启后丢失
• 用于测试和应急处理
• 命令不加 --permanent

永久配置：
• 重载后生效，重启后保留
• 用于正式的安全策略
• 命令加 --permanent，需要 --reload
```

**🔹 区域的安全等级理解**
```
从严格到宽松：
drop → block → public → work → home → trusted

选择原则：
• 服务器环境：使用 public
• 办公环境：使用 work
• 家庭环境：使用 home
• 完全信任：使用 trusted
```

**🔹 服务vs端口的选择**
```
优先使用服务：
• 标准化的规则定义
• 便于管理和理解
• 自动处理相关协议

使用端口的场景：
• 非标准端口的应用
• 需要精确控制时
• 自定义应用服务
```

### 8.3 实际应用指导


**📝 日常运维检查清单**
- [ ] 检查防火墙运行状态：`firewall-cmd --state`
- [ ] 查看当前开放服务：`firewall-cmd --list-services`
- [ ] 检查开放端口：`firewall-cmd --list-ports`
- [ ] 确认源地址白名单：`firewall-cmd --list-sources`
- [ ] 验证区域配置：`firewall-cmd --list-all`

**🔧 常用操作模板**
```bash
# 部署新服务的标准流程
# 1. 添加服务规则
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-port=8080/tcp

# 2. 重载配置
firewall-cmd --reload

# 3. 验证配置
firewall-cmd --list-all
```

**⚠️ 安全操作建议**
```
操作前准备：
• 确保有本地控制台访问权限
• 备份当前配置
• 在测试环境先验证

安全实践：
• 最小权限原则：只开放必要的服务和端口
• 源地址限制：对敏感服务限制访问来源
• 定期审查：定期检查和清理不需要的规则
• 应急预案：准备应急响应脚本
```

### 8.4 故障排除要点


```
常见问题排查：
1. 服务无法访问 → 检查服务是否添加到防火墙
2. 配置不生效 → 确认是否执行了 --reload
3. 远程连接中断 → 检查SSH服务和源地址配置
4. 端口仍被阻断 → 确认端口协议类型（TCP/UDP）

排查命令：
firewall-cmd --list-all                    # 查看完整配置
journalctl -u firewalld                   # 查看服务日志
ss -tuln                                  # 查看监听端口
nmap localhost                            # 测试端口开放状态
```

**核心记忆要点**：
- firewall-cmd是命令行管理工具，permanent参数控制配置持久性
- 区域按安全等级划分网络环境，服务比端口管理更标准化  
- 源地址控制是重要的安全防护手段，panic模式用于紧急情况
- 配置后必须reload才能让永久规则生效，操作前要做好备份