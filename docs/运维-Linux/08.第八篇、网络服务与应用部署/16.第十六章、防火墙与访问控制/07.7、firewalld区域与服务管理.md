---
title: 7ã€firewalldåŒºåŸŸä¸æœåŠ¡ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [firewalldæ¶æ„ä¸zoneæ¦‚å¿µ](#1-firewalldæ¶æ„ä¸zoneæ¦‚å¿µ)
2. [é¢„å®šä¹‰åŒºåŸŸè¯¦è§£](#2-é¢„å®šä¹‰åŒºåŸŸè¯¦è§£)
3. [åŒºåŸŸç»‘å®šä¸æ¥å£åˆ†é…](#3-åŒºåŸŸç»‘å®šä¸æ¥å£åˆ†é…)
4. [æœåŠ¡å®šä¹‰ä¸ç«¯å£ç®¡ç†](#4-æœåŠ¡å®šä¹‰ä¸ç«¯å£ç®¡ç†)
5. [rich rulesé«˜çº§è§„åˆ™è¯­æ³•](#5-rich-rulesé«˜çº§è§„åˆ™è¯­æ³•)
6. [è¿è¡Œæ—¶é…ç½®ä¸æ°¸ä¹…é…ç½®](#6-è¿è¡Œæ—¶é…ç½®ä¸æ°¸ä¹…é…ç½®)
7. [firewalldä¸iptableså…³ç³»](#7-firewalldä¸iptableså…³ç³»)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ firewalldæ¶æ„ä¸zoneæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯firewalld

ğŸ¯ **ç®€å•ç†è§£**ï¼šfirewalldå°±åƒä¸€ä¸ªæ™ºèƒ½é—¨å«ç³»ç»Ÿï¼Œæ ¹æ®ä¸åŒåŒºåŸŸåˆ¶å®šä¸åŒçš„å®‰å…¨è§„åˆ™

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
ä½å®…å°åŒºå®‰ä¿ â†’ firewalldé˜²ç«å¢™
ä¸åŒåŒºåŸŸ    â†’ zoneï¼ˆå®¢å…ã€å§å®¤ã€ä¹¦æˆ¿ï¼‰  
è®¿å®¢ç±»å‹    â†’ æœåŠ¡ï¼ˆå¿«é€’ã€æœ‹å‹ã€ç»´ä¿®å·¥ï¼‰
å®‰å…¨ç­–ç•¥    â†’ è§„åˆ™ï¼ˆè°èƒ½è¿›ï¼Œä»€ä¹ˆæ—¶å€™è¿›ï¼‰

firewalldçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š
- åŒºåŸŸåŒ–ç®¡ç†ï¼šä¸åŒç½‘ç»œç¯å¢ƒç”¨ä¸åŒå®‰å…¨ç­–ç•¥
- æœåŠ¡åŒ–é…ç½®ï¼šé¢„å®šä¹‰æœåŠ¡ç®€åŒ–è§„åˆ™è®¾ç½®
- åŠ¨æ€æ›´æ–°ï¼šæ— éœ€é‡å¯å³å¯åº”ç”¨æ–°è§„åˆ™
- å›¾å½¢ç•Œé¢ï¼šæä¾›GUIå·¥å…·ä¾¿äºç®¡ç†
```

### 1.2 firewalldæ¶æ„å±‚æ¬¡

**ğŸ“Š firewalldç³»ç»Ÿæ¶æ„å›¾**

```
åº”ç”¨å±‚ï¼š    firewall-cmd    firewall-config (GUI)
           â”‚                â”‚
APIå±‚ï¼š    firewalld å®ˆæŠ¤è¿›ç¨‹ (Python)
           â”‚
æ ¸å¿ƒå±‚ï¼š    iptables/netfilter å†…æ ¸æ¨¡å—
           â”‚
ç³»ç»Ÿå±‚ï¼š    Linuxå†…æ ¸ç½‘ç»œæ ˆ

æ•°æ®æµå‘ï¼š
ç”¨æˆ·å‘½ä»¤ â†’ firewalld â†’ iptablesè§„åˆ™ â†’ å†…æ ¸è¿‡æ»¤ â†’ ç½‘ç»œåŒ…å¤„ç†
```

**ğŸ”¸ æ ¸å¿ƒç»„ä»¶è¯´æ˜**
- **firewalldå®ˆæŠ¤è¿›ç¨‹**ï¼šåå°æœåŠ¡ï¼Œç®¡ç†æ‰€æœ‰é˜²ç«å¢™è§„åˆ™
- **firewall-cmd**ï¼šå‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œè¿ç»´äººå‘˜ä¸»è¦ä½¿ç”¨
- **firewall-config**ï¼šå›¾å½¢ç•Œé¢å·¥å…·ï¼Œæ¡Œé¢ç”¨æˆ·å‹å¥½
- **åŒºåŸŸé…ç½®æ–‡ä»¶**ï¼šå­˜å‚¨å„åŒºåŸŸçš„å…·ä½“è§„åˆ™
- **æœåŠ¡å®šä¹‰æ–‡ä»¶**ï¼šé¢„å®šä¹‰çš„æœåŠ¡ç«¯å£å’Œåè®®

### 1.3 zoneæ¦‚å¿µæ·±å…¥ç†è§£

**ğŸ¯ åŒºåŸŸçš„æ ¸å¿ƒæ€æƒ³**

zoneï¼ˆåŒºåŸŸï¼‰æ˜¯firewalldæœ€é‡è¦çš„æ¦‚å¿µï¼Œå®ƒå°†ç½‘ç»œæ¥å£æŒ‰ç…§ä¿¡ä»»çº§åˆ«åˆ†ç»„ç®¡ç†ã€‚

```
åŒºåŸŸä¿¡ä»»çº§åˆ«ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
trusted  â†’ å®Œå…¨ä¿¡ä»»ï¼Œå…è®¸æ‰€æœ‰è¿æ¥
internal â†’ å†…ç½‘åŒºåŸŸï¼Œè¾ƒé«˜ä¿¡ä»»åº¦
work     â†’ å·¥ä½œåŒºåŸŸï¼Œä¸­ç­‰ä¿¡ä»»åº¦  
home     â†’ å®¶åº­åŒºåŸŸï¼Œä¸­ç­‰ä¿¡ä»»åº¦
public   â†’ å…¬å…±åŒºåŸŸï¼Œä½ä¿¡ä»»åº¦ï¼ˆé»˜è®¤ï¼‰
external â†’ å¤–ç½‘åŒºåŸŸï¼Œå¾ˆä½ä¿¡ä»»åº¦
dmz      â†’ éå†›äº‹åŒºï¼ŒæœåŠ¡å™¨åŒºåŸŸ
drop     â†’ ä¸¢å¼ƒåŒºåŸŸï¼Œæ‹’ç»æ‰€æœ‰è¿æ¥
block    â†’ é˜»å¡åŒºåŸŸï¼Œæ˜ç¡®æ‹’ç»è¿æ¥
```

**ğŸ’¡ åŒºåŸŸé€‰æ‹©ç­–ç•¥**
- **åŠå…¬ç¯å¢ƒ**ï¼šworkåŒºåŸŸï¼Œå…è®¸å¿…è¦çš„åŠå…¬æœåŠ¡
- **å®¶åº­ç½‘ç»œ**ï¼šhomeåŒºåŸŸï¼Œä¿¡ä»»å†…ç½‘è®¾å¤‡
- **å…¬å…±WiFi**ï¼špublicåŒºåŸŸï¼Œæœ€å°æƒé™åŸåˆ™
- **æœåŠ¡å™¨ç¯å¢ƒ**ï¼šdmzåŒºåŸŸï¼Œä»…å¼€æ”¾å¿…è¦æœåŠ¡ç«¯å£
- **å®Œå…¨éš”ç¦»**ï¼šdropåŒºåŸŸï¼Œç”¨äºé«˜å®‰å…¨è¦æ±‚

### 1.4 firewalld vs ä¼ ç»Ÿiptables

**ğŸ“Š ä¸¤ç§é˜²ç«å¢™æ–¹æ¡ˆå¯¹æ¯”**

| ç‰¹æ€§å¯¹æ¯” | **firewalld** | **ä¼ ç»Ÿiptables** |
|---------|--------------|-----------------|
| ğŸ”¸ **é…ç½®æ–¹å¼** | `åŒºåŸŸåŒ–ç®¡ç†` | `é“¾å¼è§„åˆ™` |
| ğŸ”¸ **åŠ¨æ€æ›´æ–°** | `æ”¯æŒçƒ­æ›´æ–°` | `éœ€è¦é‡è½½è§„åˆ™` |
| ğŸ”¸ **å­¦ä¹ éš¾åº¦** | `ç›¸å¯¹ç®€å•` | `è¾ƒä¸ºå¤æ‚` |
| ğŸ”¸ **é…ç½®æŒä¹…åŒ–** | `è‡ªåŠ¨ä¿å­˜` | `éœ€æ‰‹åŠ¨ä¿å­˜` |
| ğŸ”¸ **å›¾å½¢ç•Œé¢** | `æä¾›GUI` | `çº¯å‘½ä»¤è¡Œ` |
| ğŸ”¸ **åº•å±‚å®ç°** | `åŸºäºiptables` | `ç›´æ¥æ“ä½œå†…æ ¸` |

---

## 2. ğŸ  é¢„å®šä¹‰åŒºåŸŸè¯¦è§£


### 2.1 å„åŒºåŸŸç‰¹æ€§ä¸é€‚ç”¨åœºæ™¯


**ğŸ”’ dropåŒºåŸŸ - æœ€ä¸¥æ ¼**
```
å®‰å…¨çº§åˆ«ï¼šæœ€é«˜
é»˜è®¤ç­–ç•¥ï¼šä¸¢å¼ƒæ‰€æœ‰å…¥ç«™è¿æ¥
å‡ºç«™ç­–ç•¥ï¼šå…è®¸ï¼ˆä»…å“åº”å·²å»ºç«‹è¿æ¥ï¼‰
é€‚ç”¨åœºæ™¯ï¼š
- é«˜æ•æ„ŸæœåŠ¡å™¨
- ä¸´æ—¶éš”ç¦»ç½‘ç»œæ¥å£
- ç½‘ç»œè°ƒè¯•æ—¶çš„å®Œå…¨éš”ç¦»

å®é™…åº”ç”¨ï¼š
æ•°æ®åº“æœåŠ¡å™¨çš„ç®¡ç†æ¥å£
æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿçš„ä¿æŠ¤
ç½‘ç»œæ•…éšœæ—¶çš„ç´§æ€¥éš”ç¦»
```

**ğŸš« blockåŒºåŸŸ - æ˜ç¡®æ‹’ç»**
```
å®‰å…¨çº§åˆ«ï¼šå¾ˆé«˜
é»˜è®¤ç­–ç•¥ï¼šæ‹’ç»æ‰€æœ‰å…¥ç«™è¿æ¥å¹¶è¿”å›æ‹’ç»ä¿¡æ¯
ä¸dropåŒºåˆ«ï¼šä¼šè¿”å›icmp-host-prohibitedæ¶ˆæ¯
é€‚ç”¨åœºæ™¯ï¼š
- éœ€è¦æ˜ç¡®å‘ŠçŸ¥è¿æ¥è¢«æ‹’ç»
- ç½‘ç»œè¯Šæ–­æ—¶ä¾¿äºå®šä½é—®é¢˜
- å¯¹å†…éƒ¨ç½‘ç»œçš„æ˜ç¡®è¾¹ç•Œåˆ’åˆ†
```

**ğŸŒ publicåŒºåŸŸ - é»˜è®¤åŒºåŸŸ**
```
å®‰å…¨çº§åˆ«ï¼šä¸­ä½
é»˜è®¤å¼€æ”¾æœåŠ¡ï¼šssh, dhcpv6-client
ç‰¹ç‚¹ï¼šä¸ä¿¡ä»»ç½‘ç»œä¸­çš„å…¶ä»–è®¡ç®—æœº
é€‚ç”¨åœºæ™¯ï¼š
- å…¬å…±åœºæ‰€ç½‘ç»œè¿æ¥
- äº‘æœåŠ¡å™¨çš„é»˜è®¤é…ç½®
- ä¸ç¡®å®šç½‘ç»œç¯å¢ƒçš„æœåŠ¡å™¨

å…¸å‹é…ç½®ï¼š
å¼€æ”¾22ç«¯å£(SSH) - è¿œç¨‹ç®¡ç†
å¼€æ”¾546ç«¯å£(DHCPv6) - è‡ªåŠ¨è·å–IPv6åœ°å€
å…¶ä»–æœåŠ¡éœ€è¦æ˜ç¡®å¼€æ”¾
```

**ğŸ¢ workåŒºåŸŸ - å·¥ä½œç¯å¢ƒ**
```
å®‰å…¨çº§åˆ«ï¼šä¸­ç­‰
é»˜è®¤å¼€æ”¾æœåŠ¡ï¼šssh, dhcpv6-client
é¢å¤–ç‰¹æ€§ï¼šå¯¹åŒç½‘æ®µè®¡ç®—æœºæœ‰é€‚åº¦ä¿¡ä»»
é€‚ç”¨åœºæ™¯ï¼š
- åŠå…¬å®¤å†…éƒ¨ç½‘ç»œ
- ä¼ä¸šå±€åŸŸç½‘ç¯å¢ƒ
- å¼€å‘æµ‹è¯•ç¯å¢ƒ

æ‰©å±•é…ç½®ç¤ºä¾‹ï¼š
å…è®¸å†…ç½‘æ–‡ä»¶å…±äº«(NFS, Samba)
å¼€æ”¾å†…éƒ¨åº”ç”¨ç«¯å£
å¯ç”¨ç½‘ç»œå‘ç°åŠŸèƒ½
```

**ğŸ¡ homeåŒºåŸŸ - å®¶åº­ç¯å¢ƒ**
```
å®‰å…¨çº§åˆ«ï¼šä¸­é«˜
é»˜è®¤æœåŠ¡ï¼šssh, mdns, samba-client, dhcpv6-client
ç‰¹ç‚¹ï¼šä¿¡ä»»ç½‘ç»œä¸­çš„å¤§éƒ¨åˆ†å…¶ä»–è®¡ç®—æœº
é€‚ç”¨åœºæ™¯ï¼š
- å®¶åº­å±€åŸŸç½‘
- å°å‹åŠå…¬å®¤ç½‘ç»œ
- ä¸ªäººå¼€å‘ç¯å¢ƒ

å®¶åº­ç½‘ç»œå…¸å‹æœåŠ¡ï¼š
åª’ä½“å…±äº«(DLNA)
æ‰“å°æœºå…±äº«
ç½‘ç»œå­˜å‚¨è®¿é—®
æ™ºèƒ½å®¶å±…è®¾å¤‡é€šä¿¡
```

**ğŸ”§ internalåŒºåŸŸ - å†…éƒ¨ç½‘ç»œ**
```
å®‰å…¨çº§åˆ«ï¼šé«˜
é»˜è®¤æœåŠ¡ï¼šssh, mdns, samba-client, dhcpv6-client
ç‰¹ç‚¹ï¼šé«˜åº¦ä¿¡ä»»å†…éƒ¨ç½‘ç»œ
é€‚ç”¨åœºæ™¯ï¼š
- ä¼ä¸šå†…ç½‘æ ¸å¿ƒåŒºåŸŸ
- æ•°æ®ä¸­å¿ƒå†…éƒ¨é€šä¿¡
- ç®¡ç†ç½‘ç»œä¸“ç”¨

å†…ç½‘ç®¡ç†æœåŠ¡ï¼š
ç½‘ç»œç®¡ç†åè®®(SNMP)
é›†ç¾¤é€šä¿¡ç«¯å£
æ•°æ®åº“é›†ç¾¤åŒæ­¥
ç›‘æ§ç³»ç»Ÿé‡‡é›†
```

### 2.2 åŒºåŸŸé»˜è®¤é…ç½®æŸ¥çœ‹

**ğŸ” æŸ¥çœ‹åŒºåŸŸè¯¦ç»†ä¿¡æ¯**

æŸ¥çœ‹æ‰€æœ‰åŒºåŸŸçš„åŸºæœ¬ä¿¡æ¯ï¼š
```bash
firewall-cmd --list-all-zones
```

æŸ¥çœ‹ç‰¹å®šåŒºåŸŸçš„è¯¦ç»†é…ç½®ï¼š
```bash
firewall-cmd --zone=public --list-all
```

æŸ¥çœ‹å½“å‰æ´»åŠ¨åŒºåŸŸï¼š
```bash
firewall-cmd --get-active-zones
```

è·å–é»˜è®¤åŒºåŸŸï¼š
```bash
firewall-cmd --get-default-zone
```

**ğŸ“‹ åŒºåŸŸé…ç½®æ–‡ä»¶ä½ç½®**
- ç³»ç»Ÿé¢„å®šä¹‰åŒºåŸŸï¼š`/usr/lib/firewalld/zones/`
- ç”¨æˆ·è‡ªå®šä¹‰åŒºåŸŸï¼š`/etc/firewalld/zones/`
- è¿è¡Œæ—¶é…ç½®ï¼šå†…å­˜ä¸­ï¼Œé‡å¯åä¸¢å¤±
- æ°¸ä¹…é…ç½®ï¼šå†™å…¥é…ç½®æ–‡ä»¶ï¼Œé‡å¯åä¿ç•™

### 2.3 åˆ›å»ºè‡ªå®šä¹‰åŒºåŸŸ

**ğŸ› ï¸ ä¼ä¸šåœºæ™¯ä¸‹çš„è‡ªå®šä¹‰åŒºåŸŸ**

åˆ›å»ºæ•°æ®åº“æœåŠ¡å™¨ä¸“ç”¨åŒºåŸŸï¼š
```bash
firewall-cmd --permanent --new-zone=database
firewall-cmd --permanent --zone=database --set-description="Database Server Zone"
firewall-cmd --permanent --zone=database --set-short="DB-Zone"
```

é…ç½®æ•°æ®åº“åŒºåŸŸè§„åˆ™ï¼š
```bash
# æ·»åŠ å¿…è¦çš„æœåŠ¡
firewall-cmd --permanent --zone=database --add-service=ssh
firewall-cmd --permanent --zone=database --add-service=mysql

# æ·»åŠ è‡ªå®šä¹‰ç«¯å£
firewall-cmd --permanent --zone=database --add-port=3306/tcp
firewall-cmd --permanent --zone=database --add-port=33060/tcp

# é™åˆ¶ç‰¹å®šæºIPè®¿é—®
firewall-cmd --permanent --zone=database --add-source=192.168.100.0/24
```

åˆ›å»ºWebæœåŠ¡å™¨åŒºåŸŸï¼š
```bash
firewall-cmd --permanent --new-zone=webserver
firewall-cmd --permanent --zone=webserver --add-service=http
firewall-cmd --permanent --zone=webserver --add-service=https
firewall-cmd --permanent --zone=webserver --add-service=ssh
```

---

## 3. ğŸ”Œ åŒºåŸŸç»‘å®šä¸æ¥å£åˆ†é…


### 3.1 ç½‘ç»œæ¥å£ä¸åŒºåŸŸç»‘å®šåŸç†

**ğŸ¯ æ¥å£ç»‘å®šçš„æ ¸å¿ƒæ¦‚å¿µ**

æ¯ä¸ªç½‘ç»œæ¥å£åªèƒ½å±äºä¸€ä¸ªåŒºåŸŸï¼Œä½†ä¸€ä¸ªåŒºåŸŸå¯ä»¥åŒ…å«å¤šä¸ªæ¥å£ã€‚firewalldæ ¹æ®æ¥å£æ‰€å±åŒºåŸŸæ¥åº”ç”¨ç›¸åº”çš„å®‰å…¨ç­–ç•¥ã€‚

```
ç»‘å®šå…³ç³»ç¤ºæ„ï¼š
eth0 (å¤–ç½‘æ¥å£) â†’ publicåŒºåŸŸ â†’ ä¸¥æ ¼çš„å®‰å…¨ç­–ç•¥
eth1 (å†…ç½‘æ¥å£) â†’ internalåŒºåŸŸ â†’ å®½æ¾çš„å†…ç½‘ç­–ç•¥
lo (å›ç¯æ¥å£) â†’ trustedåŒºåŸŸ â†’ å®Œå…¨ä¿¡ä»»

åŠ¨æ€ç»‘å®šåœºæ™¯ï¼š
ç¬”è®°æœ¬WiFiè¿æ¥ â†’ æ ¹æ®ç½‘ç»œè‡ªåŠ¨åˆ‡æ¢åŒºåŸŸ
VPNè¿æ¥å»ºç«‹ â†’ VPNæ¥å£ç»‘å®šåˆ°workåŒºåŸŸ
Dockerå®¹å™¨ç½‘ç»œ â†’ å®¹å™¨æ¥å£ç»‘å®šåˆ°ä¸“ç”¨åŒºåŸŸ
```

### 3.2 æ¥å£åˆ†é…å®æˆ˜æ“ä½œ

**ğŸ”§ æ¥å£ä¸åŒºåŸŸçš„ç®¡ç†æ“ä½œ**

æŸ¥çœ‹æ¥å£å½“å‰ç»‘å®šçš„åŒºåŸŸï¼š
```bash
firewall-cmd --get-zone-of-interface=eth0
```

å°†æ¥å£ç»‘å®šåˆ°æŒ‡å®šåŒºåŸŸï¼ˆä¸´æ—¶ï¼‰ï¼š
```bash
firewall-cmd --zone=internal --add-interface=eth1
```

æ°¸ä¹…ç»‘å®šæ¥å£åˆ°åŒºåŸŸï¼š
```bash
firewall-cmd --permanent --zone=internal --add-interface=eth1
firewall-cmd --reload
```

ç§»é™¤æ¥å£ä¸åŒºåŸŸçš„ç»‘å®šï¼š
```bash
firewall-cmd --zone=internal --remove-interface=eth1
```

**ğŸ’¡ å¤šç½‘å¡æœåŠ¡å™¨çš„åŒºåŸŸè§„åˆ’**

å…¸å‹çš„å¤šç½‘å¡æœåŠ¡å™¨é…ç½®ï¼š
- **eth0**ï¼ˆå¤–ç½‘æ¥å£ï¼‰â†’ publicåŒºåŸŸï¼Œä»…å¼€æ”¾å¿…è¦çš„å…¬å…±æœåŠ¡
- **eth1**ï¼ˆå†…ç½‘æ¥å£ï¼‰â†’ internalåŒºåŸŸï¼Œå¼€æ”¾å†…éƒ¨ç®¡ç†å’Œæ•°æ®ä¼ è¾“
- **eth2**ï¼ˆç®¡ç†æ¥å£ï¼‰â†’ trustedåŒºåŸŸï¼Œç”¨äºå¸¦å¤–ç®¡ç†

é…ç½®ç¤ºä¾‹ï¼š
```bash
# å¤–ç½‘æ¥å£é…ç½®
firewall-cmd --permanent --zone=public --add-interface=eth0
firewall-cmd --permanent --zone=public --add-service=http
firewall-cmd --permanent --zone=public --add-service=https

# å†…ç½‘æ¥å£é…ç½®  
firewall-cmd --permanent --zone=internal --add-interface=eth1
firewall-cmd --permanent --zone=internal --add-service=ssh
firewall-cmd --permanent --zone=internal --add-service=nfs

# ç®¡ç†æ¥å£é…ç½®
firewall-cmd --permanent --zone=trusted --add-interface=eth2
```

### 3.3 æºåœ°å€ç»‘å®š

**ğŸ¯ åŸºäºæºIPçš„åŒºåŸŸåˆ†é…**

é™¤äº†æ¥å£ç»‘å®šï¼Œfirewalldè¿˜æ”¯æŒåŸºäºæºIPåœ°å€çš„åŒºåŸŸåˆ†é…ï¼Œè¿™åœ¨å¤æ‚ç½‘ç»œç¯å¢ƒä¸­éå¸¸æœ‰ç”¨ã€‚

ä¸ºç‰¹å®šIPæ®µåˆ†é…åŒºåŸŸï¼š
```bash
# å†…ç½‘IPæ®µä½¿ç”¨internalåŒºåŸŸ
firewall-cmd --permanent --zone=internal --add-source=192.168.1.0/24
firewall-cmd --permanent --zone=internal --add-source=10.0.0.0/8

# åŠå…¬ç½‘æ®µä½¿ç”¨workåŒºåŸŸ
firewall-cmd --permanent --zone=work --add-source=172.16.100.0/24

# VPNå®¢æˆ·ç«¯ä½¿ç”¨homeåŒºåŸŸ
firewall-cmd --permanent --zone=home --add-source=10.8.0.0/24
```

æŸ¥çœ‹åŒºåŸŸçš„æºåœ°å€é…ç½®ï¼š
```bash
firewall-cmd --zone=internal --list-sources
```

**ğŸ“Š ä¼˜å…ˆçº§è§„åˆ™**
æºåœ°å€ç»‘å®šçš„ä¼˜å…ˆçº§é«˜äºæ¥å£ç»‘å®šï¼š
1. é¦–å…ˆæ£€æŸ¥æºIPæ˜¯å¦åŒ¹é…ç‰¹å®šåŒºåŸŸçš„æºåœ°å€èŒƒå›´
2. å¦‚æœæ²¡æœ‰åŒ¹é…çš„æºåœ°å€è§„åˆ™ï¼Œåˆ™ä½¿ç”¨æ¥å£ç»‘å®šçš„åŒºåŸŸ
3. å¦‚æœæ¥å£æ²¡æœ‰æ˜ç¡®ç»‘å®šåŒºåŸŸï¼Œåˆ™ä½¿ç”¨é»˜è®¤åŒºåŸŸ

### 3.4 åŠ¨æ€åŒºåŸŸåˆ‡æ¢

**ğŸ”„ åŸºäºç½‘ç»œç¯å¢ƒçš„è‡ªåŠ¨åŒºåŸŸåˆ‡æ¢**

NetworkManagerå¯ä»¥æ ¹æ®ç½‘ç»œè¿æ¥è‡ªåŠ¨åˆ‡æ¢firewalldåŒºåŸŸï¼š

é…ç½®NetworkManagerè¿æ¥çš„åŒºåŸŸï¼š
```bash
# æŸ¥çœ‹ç½‘ç»œè¿æ¥
nmcli connection show

# ä¸ºç‰¹å®šè¿æ¥è®¾ç½®åŒºåŸŸ
nmcli connection modify "åŠå…¬å®¤WiFi" connection.zone work
nmcli connection modify "å®¶åº­WiFi" connection.zone home
nmcli connection modify "å…¬å…±WiFi" connection.zone public
```

åˆ›å»ºåŸºäºç½‘ç»œä½ç½®çš„é…ç½®è„šæœ¬ï¼š
```bash
#!/bin/bash
# network-zone-switch.sh

# æ£€æµ‹å½“å‰ç½‘ç»œç¯å¢ƒ
current_ssid=$(iwgetid -r)
current_gateway=$(ip route | grep default | awk '{print $3}')

case "$current_ssid" in
    "Company-WiFi")
        firewall-cmd --set-default-zone=work
        echo "åˆ‡æ¢åˆ°å·¥ä½œç¯å¢ƒåŒºåŸŸ"
        ;;
    "Home-WiFi")
        firewall-cmd --set-default-zone=home
        echo "åˆ‡æ¢åˆ°å®¶åº­ç¯å¢ƒåŒºåŸŸ"
        ;;
    *)
        firewall-cmd --set-default-zone=public
        echo "åˆ‡æ¢åˆ°å…¬å…±ç¯å¢ƒåŒºåŸŸ"
        ;;
esac
```

---

## 4. ğŸ› ï¸ æœåŠ¡å®šä¹‰ä¸ç«¯å£ç®¡ç†


### 4.1 firewalldæœåŠ¡æ¦‚å¿µ

**ğŸ¯ æœåŠ¡çš„æ ¸å¿ƒä»·å€¼**

firewalldçš„æœåŠ¡æ˜¯é¢„å®šä¹‰çš„ç«¯å£å’Œåè®®ç»„åˆï¼Œç®€åŒ–äº†é˜²ç«å¢™è§„åˆ™çš„ç®¡ç†ã€‚ä¸å…¶æ‰‹åŠ¨è®°å¿†ç«¯å£å·ï¼Œä½¿ç”¨æœåŠ¡åæ›´ç›´è§‚å’Œæ ‡å‡†åŒ–ã€‚

```
ä¼ ç»Ÿiptablesæ–¹å¼ï¼š
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT

firewalldæœåŠ¡æ–¹å¼ï¼š
firewall-cmd --add-service=http
firewall-cmd --add-service=https

ä¼˜åŠ¿å¯¹æ¯”ï¼š
- è¯­ä¹‰åŒ–ï¼šhttpæ¯”80æ›´å®¹æ˜“ç†è§£
- æ ‡å‡†åŒ–ï¼šé¿å…ç«¯å£å·è®°å¿†é”™è¯¯
- æ‰¹é‡åŒ–ï¼šä¸€ä¸ªæœåŠ¡å¯åŒ…å«å¤šä¸ªç«¯å£
- ç»´æŠ¤æ€§ï¼šé›†ä¸­ç®¡ç†æœåŠ¡å®šä¹‰
```

### 4.2 é¢„å®šä¹‰æœåŠ¡ç®¡ç†

**ğŸ“‹ å¸¸ç”¨ç³»ç»ŸæœåŠ¡**

æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æœåŠ¡ï¼š
```bash
firewall-cmd --get-services
```

æŸ¥çœ‹æœåŠ¡çš„è¯¦ç»†å®šä¹‰ï¼š
```bash
firewall-cmd --info-service=ssh
firewall-cmd --info-service=http
firewall-cmd --info-service=mysql
```

å¸¸ç”¨æœåŠ¡ç«¯å£å¯¹ç…§ï¼š
- **ssh** â†’ 22/tcp
- **http** â†’ 80/tcp  
- **https** â†’ 443/tcp
- **mysql** â†’ 3306/tcp
- **postgresql** â†’ 5432/tcp
- **smtp** â†’ 25/tcp
- **dns** â†’ 53/tcp,53/udp
- **nfs** â†’ 2049/tcp + å¤šä¸ªåŠ¨æ€ç«¯å£

**ğŸ”§ æœåŠ¡ç®¡ç†æ“ä½œ**

æ·»åŠ æœåŠ¡åˆ°å½“å‰é»˜è®¤åŒºåŸŸï¼š
```bash
firewall-cmd --add-service=http
firewall-cmd --add-service=https
```

ä¸ºæŒ‡å®šåŒºåŸŸæ·»åŠ æœåŠ¡ï¼š
```bash
firewall-cmd --zone=public --add-service=ssh
firewall-cmd --zone=internal --add-service=mysql
```

æ°¸ä¹…æ·»åŠ æœåŠ¡ï¼š
```bash
firewall-cmd --permanent --add-service=http
firewall-cmd --reload
```

ç§»é™¤æœåŠ¡ï¼š
```bash
firewall-cmd --remove-service=http
firewall-cmd --permanent --remove-service=http
```

### 4.3 è‡ªå®šä¹‰æœåŠ¡åˆ›å»º

**ğŸ—ï¸ ä¼ä¸šç¯å¢ƒä¸‹çš„è‡ªå®šä¹‰æœåŠ¡**

ä¸ºä¼ä¸šåº”ç”¨åˆ›å»ºè‡ªå®šä¹‰æœåŠ¡å®šä¹‰ï¼š

åˆ›å»ºè‡ªå®šä¹‰åº”ç”¨æœåŠ¡æ–‡ä»¶ï¼š
```bash
sudo cp /usr/lib/firewalld/services/http.xml /etc/firewalld/services/myapp.xml
```

ç¼–è¾‘æœåŠ¡å®šä¹‰æ–‡ä»¶ï¼š
```xml
<?xml version="1.0" encoding="utf-8"?>
<service>
  <short>MyApp</short>
  <description>Enterprise Application Service</description>
  <port protocol="tcp" port="8080"/>
  <port protocol="tcp" port="8443"/>
  <port protocol="udp" port="9090"/>
</service>
```

é‡æ–°åŠ è½½æœåŠ¡å®šä¹‰ï¼š
```bash
firewall-cmd --reload
firewall-cmd --get-services | grep myapp
```

**ğŸ’¡ å¤æ‚æœåŠ¡å®šä¹‰ç¤ºä¾‹**

åˆ›å»ºåŒ…å«å¤šä¸ªç«¯å£çš„æ•°æ®åº“é›†ç¾¤æœåŠ¡ï¼š
```xml
<?xml version="1.0" encoding="utf-8"?>
<service>
  <short>MySQL-Cluster</short>
  <description>MySQL Cluster Service with Management and Data Ports</description>
  <port protocol="tcp" port="3306"/>   <!-- MySQLæœåŠ¡ç«¯å£ -->
  <port protocol="tcp" port="33060"/>  <!-- MySQL X Protocol -->
  <port protocol="tcp" port="1186"/>   <!-- MySQL Clusterç®¡ç†ç«¯å£ -->
  <port protocol="tcp" port="2202"/>   <!-- MySQL Clusteræ•°æ®ç«¯å£ -->
</service>
```

åˆ›å»ºå¾®æœåŠ¡åº”ç”¨ç«¯å£ç»„ï¼š
```xml
<?xml version="1.0" encoding="utf-8"?>
<service>
  <short>Microservices</short>
  <description>Enterprise Microservices Stack</description>
  <port protocol="tcp" port="8080"/>   <!-- ç”¨æˆ·æœåŠ¡ -->
  <port protocol="tcp" port="8081"/>   <!-- è®¢å•æœåŠ¡ -->
  <port protocol="tcp" port="8082"/>   <!-- æ”¯ä»˜æœåŠ¡ -->
  <port protocol="tcp" port="8083"/>   <!-- é€šçŸ¥æœåŠ¡ -->
  <port protocol="tcp" port="9090"/>   <!-- ç›‘æ§ç«¯å£ -->
</service>
```

### 4.4 ç«¯å£ç®¡ç†æ“ä½œ

**ğŸ”Œ ç›´æ¥ç«¯å£æ“ä½œ**

å½“æ²¡æœ‰åˆé€‚çš„é¢„å®šä¹‰æœåŠ¡æ—¶ï¼Œå¯ä»¥ç›´æ¥æ“ä½œç«¯å£ï¼š

æ·»åŠ å•ä¸ªç«¯å£ï¼š
```bash
firewall-cmd --add-port=8080/tcp
firewall-cmd --add-port=5353/udp
```

æ·»åŠ ç«¯å£èŒƒå›´ï¼š
```bash
firewall-cmd --add-port=8000-8999/tcp
firewall-cmd --add-port=60000-61000/udp
```

æŸ¥çœ‹å·²å¼€æ”¾çš„ç«¯å£ï¼š
```bash
firewall-cmd --list-ports
firewall-cmd --zone=internal --list-ports
```

ç§»é™¤ç«¯å£ï¼š
```bash
firewall-cmd --remove-port=8080/tcp
firewall-cmd --permanent --remove-port=8080/tcp
```

**âš ï¸ ç«¯å£ç®¡ç†æœ€ä½³å®è·µ**
- ä¼˜å…ˆä½¿ç”¨æœåŠ¡å®šä¹‰è€Œä¸æ˜¯ç›´æ¥ç«¯å£æ“ä½œ
- ä¸ºè‡ªå®šä¹‰åº”ç”¨åˆ›å»ºä¸“é—¨çš„æœåŠ¡å®šä¹‰
- å®šæœŸå®¡æŸ¥å¼€æ”¾çš„ç«¯å£ï¼Œå…³é—­ä¸å¿…è¦çš„æœåŠ¡
- ä½¿ç”¨ç«¯å£èŒƒå›´æ—¶è¦ç‰¹åˆ«è°¨æ…ï¼Œé¿å…è¿‡åº¦å¼€æ”¾

---

## 5. ğŸ“ rich rulesé«˜çº§è§„åˆ™è¯­æ³•


### 5.1 rich rulesæ¦‚å¿µä¸ä¼˜åŠ¿

**ğŸ¯ å¯Œè§„åˆ™çš„æ ¸å¿ƒä»·å€¼**

rich rulesï¼ˆå¯Œè§„åˆ™ï¼‰æ˜¯firewalldæä¾›çš„é«˜çº§è§„åˆ™è¯­æ³•ï¼Œå…è®¸åˆ›å»ºæ¯”åŸºæœ¬æœåŠ¡å’Œç«¯å£æ›´å¤æ‚çš„é˜²ç«å¢™è§„åˆ™ã€‚

```
åŸºæœ¬è§„åˆ™çš„å±€é™æ€§ï¼š
- åªèƒ½ç®€å•å¼€æ”¾/å…³é—­æœåŠ¡
- æ— æ³•æŒ‡å®šç‰¹å®šæºIP
- ä¸èƒ½è®¾ç½®æ—¥å¿—è®°å½•
- ç¼ºä¹åŠ¨ä½œçš„å¤šæ ·æ€§

å¯Œè§„åˆ™çš„å¼ºå¤§åŠŸèƒ½ï¼š
- ç²¾ç¡®çš„æº/ç›®æ ‡åœ°å€æ§åˆ¶
- çµæ´»çš„ç«¯å£å’Œåè®®ç»„åˆ
- ä¸°å¯Œçš„åŠ¨ä½œé€‰æ‹©ï¼ˆacceptã€rejectã€dropï¼‰
- è¯¦ç»†çš„æ—¥å¿—è®°å½•åŠŸèƒ½
- è¿æ¥é€Ÿç‡é™åˆ¶
```

### 5.2 rich rulesåŸºæœ¬è¯­æ³•

**ğŸ“‹ å¯Œè§„åˆ™è¯­æ³•ç»“æ„**

å¯Œè§„åˆ™çš„åŸºæœ¬è¯­æ³•æ ¼å¼ï¼š
```
rule [family="ipv4|ipv6"]
     [source [address="address"] [mac="mac"] [invert="True"]]
     [destination [address="address"] [invert="True"]]
     [element]
     [log [prefix="prefix text"] [level="log level"] [limit value="rate/duration"]]
     [audit]
     action
```

**ğŸ”§ è¯­æ³•å…ƒç´ è¯¦è§£**

**family**ï¼šæŒ‡å®šIPåè®®ç‰ˆæœ¬
- `ipv4`ï¼šä»…é€‚ç”¨äºIPv4ï¼ˆé»˜è®¤ï¼‰
- `ipv6`ï¼šä»…é€‚ç”¨äºIPv6

**source**ï¼šæºåœ°å€æ§åˆ¶
- `address`ï¼šæºIPåœ°å€æˆ–ç½‘æ®µ
- `mac`ï¼šæºMACåœ°å€
- `invert`ï¼šåè½¬æ¡ä»¶ï¼ˆé™¤äº†æŒ‡å®šåœ°å€å¤–çš„æ‰€æœ‰åœ°å€ï¼‰

**destination**ï¼šç›®æ ‡åœ°å€æ§åˆ¶
- `address`ï¼šç›®æ ‡IPåœ°å€æˆ–ç½‘æ®µ

**element**ï¼šè§„åˆ™å…ƒç´ 
- `service`ï¼šæœåŠ¡åç§°
- `port`ï¼šç«¯å£å’Œåè®®
- `protocol`ï¼šåè®®ç±»å‹
- `icmp-block`ï¼šICMPæ¶ˆæ¯ç±»å‹
- `masquerade`ï¼šåœ°å€ä¼ªè£…
- `forward-port`ï¼šç«¯å£è½¬å‘

**action**ï¼šæ‰§è¡ŒåŠ¨ä½œ
- `accept`ï¼šå…è®¸è¿æ¥
- `reject`ï¼šæ‹’ç»è¿æ¥å¹¶è¿”å›æ‹’ç»ä¿¡æ¯
- `drop`ï¼šä¸¢å¼ƒè¿æ¥ï¼Œä¸è¿”å›ä»»ä½•ä¿¡æ¯

### 5.3 rich ruleså®æˆ˜åº”ç”¨

**ğŸš€ å®é™…åœºæ™¯ä¸­çš„å¯Œè§„åˆ™åº”ç”¨**

**åœºæ™¯1ï¼šé™åˆ¶SSHè®¿é—®æºIP**
```bash
# åªå…è®¸ç®¡ç†ç½‘æ®µè®¿é—®SSH
firewall-cmd --permanent --add-rich-rule='
rule family="ipv4" 
source address="192.168.100.0/24" 
service name="ssh" 
accept'

# æ‹’ç»å…¶ä»–æ‰€æœ‰SSHè¿æ¥
firewall-cmd --permanent --add-rich-rule='
rule family="ipv4" 
service name="ssh" 
reject'
```

**åœºæ™¯2ï¼šWebæœåŠ¡è®¿é—®æ§åˆ¶ä¸æ—¥å¿—**
```bash
# å…è®¸æ­£å¸¸Webè®¿é—®å¹¶è®°å½•æ—¥å¿—
firewall-cmd --permanent --add-rich-rule='
rule family="ipv4" 
service name="http" 
log prefix="HTTP-Access: " level="info" limit value="10/m" 
accept'

# é˜»æ­¢ç‰¹å®šIPè®¿é—®WebæœåŠ¡
firewall-cmd --permanent --add-rich-rule='
rule family="ipv4" 
source address="192.168.1.100" 
service name="http" 
log prefix="HTTP-Blocked: " level="warning" 
reject'
```

**åœºæ™¯3ï¼šæ•°æ®åº“è®¿é—®çš„ç²¾ç»†æ§åˆ¶**
```bash
# åªå…è®¸åº”ç”¨æœåŠ¡å™¨è®¿é—®æ•°æ®åº“
firewall-cmd --permanent --zone=internal --add-rich-rule='
rule family="ipv4" 
source address="192.168.10.0/24" 
port protocol="tcp" port="3306" 
accept'

# é™åˆ¶æ•°æ®åº“è¿æ¥é¢‘ç‡
firewall-cmd --permanent --zone=internal --add-rich-rule='
rule family="ipv4" 
port protocol="tcp" port="3306" 
log prefix="DB-Connection: " level="info" limit value="5/m" 
accept'
```

**åœºæ™¯4ï¼šç«¯å£æ•²é—¨ï¼ˆPort Knockingï¼‰æ¨¡æ‹Ÿ**
```bash
# ç¬¬ä¸€é˜¶æ®µï¼šå…è®¸ç‰¹å®šç«¯å£çš„è®¿é—®å°è¯•
firewall-cmd --permanent --add-rich-rule='
rule family="ipv4" 
port protocol="tcp" port="1234" 
log prefix="Knock-Stage1: " level="info" 
drop'

# ç®¡ç†ç«¯å£ï¼šé™åˆ¶ç‰¹å®šæ—¶é—´çª—å£å†…çš„è®¿é—®
firewall-cmd --permanent --add-rich-rule='
rule family="ipv4" 
source address="192.168.1.0/24" 
port protocol="tcp" port="22" 
log prefix="SSH-Admin: " level="info" limit value="3/m" 
accept'
```

### 5.4 å¯Œè§„åˆ™ç®¡ç†æ“ä½œ

**ğŸ”§ å¯Œè§„åˆ™çš„æ—¥å¸¸ç®¡ç†**

æŸ¥çœ‹æ‰€æœ‰å¯Œè§„åˆ™ï¼š
```bash
firewall-cmd --list-rich-rules
firewall-cmd --zone=public --list-rich-rules
```

åˆ é™¤å¯Œè§„åˆ™ï¼š
```bash
firewall-cmd --permanent --remove-rich-rule='
rule family="ipv4" 
source address="192.168.1.100" 
service name="ssh" 
reject'
```

å¯Œè§„åˆ™çš„ä¼˜å…ˆçº§ç®¡ç†ï¼š
- å¯Œè§„åˆ™æŒ‰æ·»åŠ é¡ºåºæ‰§è¡Œ
- ç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™å†³å®šæœ€ç»ˆåŠ¨ä½œ
- å¯ä»¥é€šè¿‡åˆ é™¤å’Œé‡æ–°æ·»åŠ æ¥è°ƒæ•´é¡ºåº

**ğŸ’¡ å¯Œè§„åˆ™è°ƒè¯•æŠ€å·§**
```bash
# ä¸´æ—¶æ·»åŠ è§„åˆ™è¿›è¡Œæµ‹è¯•
firewall-cmd --add-rich-rule='rule family="ipv4" source address="192.168.1.10" service name="ssh" accept'

# æŸ¥çœ‹è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ
firewall-cmd --list-rich-rules

# æµ‹è¯•é€šè¿‡åå†è®¾ç½®ä¸ºæ°¸ä¹…
firewall-cmd --permanent --add-rich-rule='...'
firewall-cmd --reload
```

---

## 6. âš¡ è¿è¡Œæ—¶é…ç½®ä¸æ°¸ä¹…é…ç½®


### 6.1 é…ç½®ç±»å‹çš„åŒºåˆ«ä¸æ„ä¹‰

**ğŸ¯ ä¸¤ç§é…ç½®æ¨¡å¼çš„æ ¸å¿ƒç†è§£**

firewalldæä¾›äº†ä¸¤ç§é…ç½®æ¨¡å¼ï¼Œè¿™ç§è®¾è®¡è®©ç®¡ç†å‘˜å¯ä»¥å®‰å…¨åœ°æµ‹è¯•é˜²ç«å¢™è§„åˆ™ã€‚

```
è¿è¡Œæ—¶é…ç½®ï¼ˆRuntime Configurationï¼‰ï¼š
ç‰¹ç‚¹ï¼šç«‹å³ç”Ÿæ•ˆï¼Œé‡å¯åä¸¢å¤±
ç”¨é€”ï¼šä¸´æ—¶è°ƒè¯•ã€ç´§æ€¥ä¿®å¤ã€è§„åˆ™æµ‹è¯•
åœºæ™¯ï¼šéœ€è¦å¿«é€Ÿå¼€æ”¾ç«¯å£è¿›è¡Œæ•…éšœæ’æŸ¥

æ°¸ä¹…é…ç½®ï¼ˆPermanent Configurationï¼‰ï¼š
ç‰¹ç‚¹ï¼šéœ€è¦reloadæ‰ç”Ÿæ•ˆï¼Œé‡å¯åä¿ç•™  
ç”¨é€”ï¼šæ­£å¼çš„é˜²ç«å¢™ç­–ç•¥ã€é•¿æœŸè§„åˆ™
åœºæ™¯ï¼šç”Ÿäº§ç¯å¢ƒçš„æ ‡å‡†å®‰å…¨é…ç½®

é…ç½®å…³ç³»ï¼š
Runtime Config â†â†’ å†…å­˜ä¸­çš„è§„åˆ™ â†â†’ å®é™…ç”Ÿæ•ˆçš„é˜²ç«å¢™
Permanent Config â†â†’ é…ç½®æ–‡ä»¶ â†â†’ ç³»ç»Ÿé‡å¯åçš„è§„åˆ™
```

### 6.2 è¿è¡Œæ—¶é…ç½®ç®¡ç†

**âš¡ ä¸´æ—¶é…ç½®çš„ä½¿ç”¨åœºæ™¯**

è¿è¡Œæ—¶é…ç½®ä¸»è¦ç”¨äºç´§æ€¥æƒ…å†µå’Œè§„åˆ™æµ‹è¯•ï¼š

ä¸´æ—¶å¼€æ”¾ç«¯å£è¿›è¡Œç´§æ€¥è®¿é—®ï¼š
```bash
# ç´§æ€¥æƒ…å†µï¼šä¸´æ—¶å¼€æ”¾SSHç«¯å£
firewall-cmd --add-service=ssh

# ä¸´æ—¶å¼€æ”¾åº”ç”¨ç«¯å£è¿›è¡Œè°ƒè¯•
firewall-cmd --add-port=8080/tcp

# ä¸´æ—¶æ·»åŠ å¯Œè§„åˆ™
firewall-cmd --add-rich-rule='rule family="ipv4" source address="192.168.1.100" service name="ssh" accept'
```

æŸ¥çœ‹å½“å‰è¿è¡Œæ—¶é…ç½®ï¼š
```bash
firewall-cmd --list-all
firewall-cmd --list-services
firewall-cmd --list-ports
firewall-cmd --list-rich-rules
```

**ğŸ”§ è¿è¡Œæ—¶é…ç½®çš„æœ€ä½³å®è·µ**

è¿è¡Œæ—¶é…ç½®æµ‹è¯•æµç¨‹ï¼š
```bash
# 1. è®°å½•å½“å‰é…ç½®çŠ¶æ€
firewall-cmd --list-all > /tmp/firewall-backup.txt

# 2. æ·»åŠ ä¸´æ—¶æµ‹è¯•è§„åˆ™
firewall-cmd --add-service=http

# 3. æµ‹è¯•è§„åˆ™æ•ˆæœ
curl http://localhost

# 4. ç¡®è®¤è§„åˆ™æ­£ç¡®åè®¾ä¸ºæ°¸ä¹…
firewall-cmd --permanent --add-service=http
firewall-cmd --reload

# 5. æˆ–è€…æ”¾å¼ƒæ›´æ”¹ï¼ˆé‡å¯æœåŠ¡ï¼‰
systemctl restart firewalld
```

### 6.3 æ°¸ä¹…é…ç½®ç®¡ç†

**ğŸ’¾ æŒä¹…åŒ–é…ç½®çš„ç®¡ç†æ–¹æ³•**

æ°¸ä¹…é…ç½®æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­çš„æ ‡å‡†åšæ³•ï¼š

è®¾ç½®æ°¸ä¹…è§„åˆ™ï¼š
```bash
# æ°¸ä¹…æ·»åŠ æœåŠ¡
firewall-cmd --permanent --add-service=https

# æ°¸ä¹…æ·»åŠ ç«¯å£
firewall-cmd --permanent --add-port=8443/tcp

# æ°¸ä¹…æ·»åŠ å¯Œè§„åˆ™
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="10.0.0.0/8" service name="ssh" accept'

# åº”ç”¨æ°¸ä¹…é…ç½®
firewall-cmd --reload
```

æŸ¥çœ‹æ°¸ä¹…é…ç½®ï¼š
```bash
firewall-cmd --permanent --list-all
firewall-cmd --permanent --list-services
firewall-cmd --permanent --zone=internal --list-all
```

**ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®ä¸ç»“æ„**

æ°¸ä¹…é…ç½®å­˜å‚¨ä½ç½®ï¼š
- ç³»ç»Ÿé…ç½®ï¼š`/usr/lib/firewalld/`
- ç”¨æˆ·é…ç½®ï¼š`/etc/firewalld/`
- åŒºåŸŸé…ç½®ï¼š`/etc/firewalld/zones/`
- æœåŠ¡é…ç½®ï¼š`/etc/firewalld/services/`

å…¸å‹åŒºåŸŸé…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆ`/etc/firewalld/zones/public.xml`ï¼‰ï¼š
```xml
<?xml version="1.0" encoding="utf-8"?>
<zone>
  <short>Public</short>
  <description>å…¬å…±åŒºåŸŸé…ç½®</description>
  <service name="ssh"/>
  <service name="dhcpv6-client"/>
  <service name="http"/>
  <service name="https"/>
  <port protocol="tcp" port="8080"/>
  <rule family="ipv4">
    <source address="192.168.1.0/24"/>
    <service name="mysql"/>
    <accept/>
  </rule>
</zone>
```

### 6.4 é…ç½®åŒæ­¥ä¸ç®¡ç†

**ğŸ”„ è¿è¡Œæ—¶ä¸æ°¸ä¹…é…ç½®çš„åŒæ­¥**

é…ç½®åŒæ­¥æ“ä½œï¼š

å°†è¿è¡Œæ—¶é…ç½®åŒæ­¥ä¸ºæ°¸ä¹…é…ç½®ï¼š
```bash
firewall-cmd --runtime-to-permanent
```

ç”¨æ°¸ä¹…é…ç½®è¦†ç›–è¿è¡Œæ—¶é…ç½®ï¼š
```bash
firewall-cmd --reload
```

å®Œå…¨é‡ç½®ä¸ºæ°¸ä¹…é…ç½®ï¼š
```bash
firewall-cmd --complete-reload
```

**ğŸ“Š é…ç½®ç®¡ç†ç­–ç•¥**

| æ“ä½œåœºæ™¯ | **æ¨èæ–¹æ³•** | **å‘½ä»¤ç¤ºä¾‹** |
|---------|------------|-------------|
| ğŸ”¸ **ç”Ÿäº§ç¯å¢ƒé…ç½®** | `ç›´æ¥æ°¸ä¹…é…ç½®` | `--permanent + --reload` |
| ğŸ”¸ **è§„åˆ™æµ‹è¯•** | `å…ˆä¸´æ—¶å†æ°¸ä¹…` | `æµ‹è¯•â†’--runtime-to-permanent` |
| ğŸ”¸ **ç´§æ€¥ä¿®å¤** | `ä¸´æ—¶é…ç½®` | `ç›´æ¥è¿è¡Œæ—¶æ“ä½œ` |
| ğŸ”¸ **æ‰¹é‡é…ç½®** | `é…ç½®æ–‡ä»¶ç¼–è¾‘` | `vi /etc/firewalld/zones/xxx.xml` |

**ğŸ’¡ é…ç½®å¤‡ä»½ä¸æ¢å¤**
```bash
# å¤‡ä»½å½“å‰é…ç½®
cp -r /etc/firewalld /backup/firewalld-$(date +%Y%m%d)

# å¯¼å‡ºå½“å‰è§„åˆ™
firewall-cmd --list-all-zones > /backup/firewall-rules-$(date +%Y%m%d).txt

# æ¢å¤é…ç½®
cp -r /backup/firewalld-20241201 /etc/firewalld
firewall-cmd --complete-reload
```

---

## 7. ğŸ”— firewalldä¸iptableså…³ç³»


### 7.1 åº•å±‚å®ç°å…³ç³»

**ğŸ¯ firewalldçš„æŠ€æœ¯æ¶æ„**

firewalldå¹¶ä¸æ˜¯æ›¿ä»£iptablesï¼Œè€Œæ˜¯åœ¨iptablesä¹‹ä¸Šçš„é«˜çº§ç®¡ç†å±‚ã€‚

```
æŠ€æœ¯æ¶æ„å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   firewall-cmd      â”‚ â† ç”¨æˆ·æ¥å£å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   firewalld daemon  â”‚ â† ç®¡ç†æœåŠ¡å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   iptables          â”‚ â† è§„åˆ™æ‰§è¡Œå±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   netfilter         â”‚ â† å†…æ ¸è¿‡æ»¤æ¡†æ¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®é™…å·¥ä½œæµç¨‹ï¼š
ç”¨æˆ·æ‰§è¡Œfirewall-cmdå‘½ä»¤
â†’ firewalldå®ˆæŠ¤è¿›ç¨‹è§£æå‘½ä»¤
â†’ ç”Ÿæˆå¯¹åº”çš„iptablesè§„åˆ™
â†’ è°ƒç”¨iptableså‘½ä»¤
â†’ netfilterå†…æ ¸æ¨¡å—æ‰§è¡Œè¿‡æ»¤
```

### 7.2 iptablesè§„åˆ™æ˜ å°„

**ğŸ” firewalldå¦‚ä½•ç”Ÿæˆiptablesè§„åˆ™**

æŸ¥çœ‹firewalldç”Ÿæˆçš„iptablesè§„åˆ™ï¼š
```bash
# æŸ¥çœ‹natè¡¨
iptables -t nat -L -n

# æŸ¥çœ‹filterè¡¨
iptables -t filter -L -n

# æŸ¥çœ‹ç‰¹å®šé“¾
iptables -L INPUT -n
iptables -L FORWARD -n
```

**ğŸ“Š firewalldè§„åˆ™åœ¨iptablesä¸­çš„ä½“ç°**

firewalldä¼šåœ¨iptablesä¸­åˆ›å»ºä¸“é—¨çš„é“¾ï¼š
- `FWDI_*` - Forwardç›¸å…³é“¾
- `FWDO_*` - Forward Outputç›¸å…³é“¾  
- `IN_*` - Inputç›¸å…³é“¾ï¼Œä»¥åŒºåŸŸå‘½å
- `OUT_*` - Outputç›¸å…³é“¾

ç¤ºä¾‹ï¼špublicåŒºåŸŸçš„INPUTè§„åˆ™ï¼š
```bash
# firewalldå‘½ä»¤
firewall-cmd --zone=public --add-service=ssh

# å¯¹åº”çš„iptablesè§„åˆ™
iptables -A IN_public_allow -p tcp --dport 22 -j ACCEPT
```

### 7.3 æ··åˆä½¿ç”¨çš„æ³¨æ„äº‹é¡¹

**âš ï¸ firewalldä¸iptableså…±å­˜çš„é—®é¢˜**

**ä¸å»ºè®®æ··åˆä½¿ç”¨çš„åŸå› **ï¼š
1. **è§„åˆ™å†²çª**ï¼šä¸¤è€…å¯èƒ½äº§ç”Ÿç›¸äº’è¦†ç›–çš„è§„åˆ™
2. **ç®¡ç†å¤æ‚**ï¼šéš¾ä»¥ç¡®å®šå“ªä¸ªå·¥å…·ç”Ÿæˆäº†ç‰¹å®šè§„åˆ™
3. **è°ƒè¯•å›°éš¾**ï¼šé—®é¢˜æ’æŸ¥æ—¶éœ€è¦æ£€æŸ¥ä¸¤å¥—è§„åˆ™ç³»ç»Ÿ
4. **é…ç½®æ··ä¹±**ï¼šè§„åˆ™åˆ†æ•£åœ¨ä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­

**å¦‚æœå¿…é¡»æ··åˆä½¿ç”¨**ï¼š
```bash
# æ–¹æ³•1ï¼šåœ¨firewalldä¸­å¼€æ”¾æ‰€æœ‰ç«¯å£ï¼Œç”¨iptablesç»†åŒ–æ§åˆ¶
firewall-cmd --zone=trusted --add-interface=eth0

# ç„¶åç”¨iptablesæ·»åŠ å…·ä½“é™åˆ¶
iptables -I INPUT -i eth0 -p tcp --dport 22 -s 192.168.1.0/24 -j ACCEPT
iptables -I INPUT -i eth0 -p tcp --dport 22 -j DROP

# æ–¹æ³•2ï¼šç¦ç”¨firewalldï¼Œçº¯ç”¨iptables
systemctl stop firewalld
systemctl disable firewalld
systemctl enable iptables
```

### 7.4 è¿ç§»ç­–ç•¥

**ğŸ”„ ä»iptablesè¿ç§»åˆ°firewalld**

**è¿ç§»å‡†å¤‡å·¥ä½œ**ï¼š
1. å¤‡ä»½ç°æœ‰iptablesè§„åˆ™
2. åˆ†æå½“å‰è§„åˆ™çš„ä¸šåŠ¡é€»è¾‘  
3. è®¾è®¡firewalldçš„åŒºåŸŸè§„åˆ’
4. å‡†å¤‡å›æ»šæ–¹æ¡ˆ

```bash
# 1. å¤‡ä»½ç°æœ‰iptablesè§„åˆ™
iptables-save > /backup/iptables-rules-$(date +%Y%m%d).txt

# 2. åˆ†æç°æœ‰è§„åˆ™
iptables -L -n --line-numbers > /tmp/iptables-analysis.txt

# 3. åœæ­¢iptablesæœåŠ¡
systemctl stop iptables
systemctl disable iptables

# 4. å¯åŠ¨firewalld
systemctl start firewalld
systemctl enable firewalld

# 5. æ ¹æ®åˆ†æç»“æœé…ç½®firewalld
firewall-cmd --permanent --zone=public --add-service=ssh
firewall-cmd --permanent --zone=public --add-service=http
# ... å…¶ä»–è§„åˆ™é…ç½®

# 6. åº”ç”¨é…ç½®å¹¶æµ‹è¯•
firewall-cmd --reload
```

**ğŸ“‹ è¿ç§»å¯¹ç…§è¡¨**

| iptablesè§„åˆ™ | **firewalldç­‰ä»·é…ç½®** |
|-------------|---------------------|
| `-A INPUT -p tcp --dport 22 -j ACCEPT` | `--add-service=ssh` |
| `-A INPUT -p tcp --dport 80 -j ACCEPT` | `--add-service=http` |
| `-A INPUT -s 192.168.1.0/24 -j ACCEPT` | `--add-source=192.168.1.0/24` |
| `-A INPUT -i eth0 -j DROP` | `--zone=drop --add-interface=eth0` |

**ğŸ”„ å›æ»šæ–¹æ¡ˆ**
```bash
# å¦‚æœfirewalldé…ç½®æœ‰é—®é¢˜ï¼Œå¿«é€Ÿå›æ»šåˆ°iptables
systemctl stop firewalld
systemctl disable firewalld

# æ¢å¤iptablesè§„åˆ™
iptables-restore < /backup/iptables-rules-20241201.txt

# å¯åŠ¨iptablesæœåŠ¡
systemctl start iptables
systemctl enable iptables
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ firewalldæ¶æ„ï¼šåŸºäºzoneæ¦‚å¿µçš„åˆ†å±‚é˜²ç«å¢™ç®¡ç†ç³»ç»Ÿ
ğŸ”¸ zoneåŒºåŸŸï¼šæ ¹æ®ä¿¡ä»»çº§åˆ«åˆ’åˆ†çš„ç½‘ç»œå®‰å…¨ç­–ç•¥ç»„
ğŸ”¸ æœåŠ¡å®šä¹‰ï¼šé¢„é…ç½®çš„ç«¯å£å’Œåè®®ç»„åˆï¼Œç®€åŒ–è§„åˆ™ç®¡ç†
ğŸ”¸ rich rulesï¼šé«˜çº§è§„åˆ™è¯­æ³•ï¼Œæ”¯æŒå¤æ‚çš„è®¿é—®æ§åˆ¶ç­–ç•¥
ğŸ”¸ é…ç½®æ¨¡å¼ï¼šè¿è¡Œæ—¶é…ç½®ç”¨äºæµ‹è¯•ï¼Œæ°¸ä¹…é…ç½®ç”¨äºç”Ÿäº§
ğŸ”¸ æ¥å£ç»‘å®šï¼šç½‘ç»œæ¥å£ä¸å®‰å…¨åŒºåŸŸçš„å…³è”å…³ç³»
ğŸ”¸ åº•å±‚å®ç°ï¼šfirewalldåŸºäºiptablesï¼Œæä¾›æ›´å‹å¥½çš„ç®¡ç†æ¥å£
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ zoneæ¦‚å¿µçš„æ ¸å¿ƒä»·å€¼**
```
åŒºåŸŸåŒ–ç®¡ç†ä¼˜åŠ¿ï¼š
- æ ¹æ®ç½‘ç»œç¯å¢ƒè‡ªåŠ¨åº”ç”¨åˆé€‚çš„å®‰å…¨ç­–ç•¥
- ç®€åŒ–å¤šç½‘å¡æœåŠ¡å™¨çš„é˜²ç«å¢™é…ç½®
- æä¾›é¢„å®šä¹‰çš„å®‰å…¨çº§åˆ«æ¨¡æ¿
- æ”¯æŒåŠ¨æ€çš„ç½‘ç»œç¯å¢ƒåˆ‡æ¢

å®é™…åº”ç”¨ä»·å€¼ï¼š
- ç¬”è®°æœ¬åœ¨ä¸åŒç½‘ç»œé—´åˆ‡æ¢æ—¶è‡ªåŠ¨è°ƒæ•´å®‰å…¨ç­–ç•¥
- æœåŠ¡å™¨å¤šç½‘å¡ç¯å¢ƒä¸‹çš„ç²¾ç»†åŒ–è®¿é—®æ§åˆ¶
- ä¼ä¸šç½‘ç»œä¸­ä¸åŒå®‰å…¨åŸŸçš„ç»Ÿä¸€ç®¡ç†
```

**ğŸ”¹ æœåŠ¡å®šä¹‰çš„ç®¡ç†ä¼˜åŠ¿**
```
æ ‡å‡†åŒ–ç®¡ç†ï¼š
- ä½¿ç”¨è¯­ä¹‰åŒ–çš„æœåŠ¡åè€Œä¸æ˜¯ç«¯å£å·
- å‡å°‘é…ç½®é”™è¯¯å’Œç«¯å£è®°å¿†è´Ÿæ‹…
- æ”¯æŒå¤æ‚åº”ç”¨çš„ç«¯å£ç»„åˆå®šä¹‰
- ä¾¿äºå›¢é˜Ÿåä½œå’ŒçŸ¥è¯†ä¼ æ‰¿

æ‰©å±•æ€§æ”¯æŒï¼š
- æ”¯æŒè‡ªå®šä¹‰æœåŠ¡å®šä¹‰
- å¯ä»¥åŒ…å«å¤šä¸ªç«¯å£å’Œåè®®
- ä¾¿äºä¼ä¸šåº”ç”¨çš„æ ‡å‡†åŒ–éƒ¨ç½²
```

**ğŸ”¹ è¿è¡Œæ—¶ä¸æ°¸ä¹…é…ç½®çš„è®¾è®¡æ€æƒ³**
```
å®‰å…¨æ€§è€ƒè™‘ï¼š
- è¿è¡Œæ—¶é…ç½®å…è®¸å®‰å…¨çš„è§„åˆ™æµ‹è¯•
- é¿å…é”™è¯¯é…ç½®å¯¼è‡´çš„æ°¸ä¹…æ€§ç½‘ç»œä¸­æ–­
- æä¾›å¿«é€Ÿå›æ»šæœºåˆ¶

ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µï¼š
- æµ‹è¯•ç¯å¢ƒä½¿ç”¨è¿è¡Œæ—¶é…ç½®éªŒè¯è§„åˆ™
- ç¡®è®¤æ— è¯¯åè½¬ä¸ºæ°¸ä¹…é…ç½®
- å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒåº”ç”¨åœºæ™¯**
- **WebæœåŠ¡å™¨**ï¼špublicåŒºåŸŸéƒ¨ç½²ï¼Œç²¾ç¡®æ§åˆ¶HTTP/HTTPSè®¿é—®
- **æ•°æ®åº“æœåŠ¡å™¨**ï¼šinternalåŒºåŸŸéƒ¨ç½²ï¼Œé™åˆ¶æ•°æ®åº“è®¿é—®æº
- **è·³æ¿æœº**ï¼šworkåŒºåŸŸé…ç½®ï¼Œç®¡ç†å‘˜å®‰å…¨è®¿é—®å…¥å£
- **å®¹å™¨ç¯å¢ƒ**ï¼šä¸ºä¸åŒç±»å‹å®¹å™¨é…ç½®ä¸“ç”¨å®‰å…¨åŒºåŸŸ

**ğŸ”§ è¿ç»´å®è·µå»ºè®®**
- **åŒºåŸŸè§„åˆ’**ï¼šæ ¹æ®ä¸šåŠ¡æ¶æ„è®¾è®¡åˆç†çš„åŒºåŸŸåˆ’åˆ†
- **æœåŠ¡æ ‡å‡†åŒ–**ï¼šä¸ºä¼ä¸šåº”ç”¨åˆ›å»ºæ ‡å‡†çš„æœåŠ¡å®šä¹‰
- **é…ç½®ç®¡ç†**ï¼šå»ºç«‹é…ç½®ç‰ˆæœ¬æ§åˆ¶å’Œå˜æ›´å®¡æ‰¹æµç¨‹
- **ç›‘æ§å‘Šè­¦**ï¼šé…åˆæ—¥å¿—ç³»ç»Ÿç›‘æ§é˜²ç«å¢™è§„åˆ™çš„æ‰§è¡Œæƒ…å†µ

**ğŸ“ˆ æŠ€æœ¯å‘å±•è¶‹åŠ¿**
- **å®¹å™¨é›†æˆ**ï¼šä¸Dockerã€Kubernetesç­‰å®¹å™¨å¹³å°çš„æ·±åº¦é›†æˆ
- **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šç»“åˆAnsibleã€Puppetç­‰è‡ªåŠ¨åŒ–å·¥å…·
- **äº‘åŸç”Ÿæ”¯æŒ**ï¼šé€‚åº”äº‘ç¯å¢ƒä¸‹çš„åŠ¨æ€ç½‘ç»œç®¡ç†
- **å®‰å…¨å¢å¼º**ï¼šé›†æˆå…¥ä¾µæ£€æµ‹å’Œå¨èƒæƒ…æŠ¥åŠŸèƒ½

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åŒºåŸŸç®¡ç†åˆ†å±‚æ¬¡ï¼Œä¿¡ä»»çº§åˆ«å®šç­–ç•¥
- æœåŠ¡å®šä¹‰æ ‡å‡†åŒ–ï¼Œç«¯å£ç®¡ç†æ›´ä¾¿æ·  
- å¯Œè§„åˆ™è¯­æ³•å¼ºï¼Œå¤æ‚æ§åˆ¶ä¸åœ¨è¯ä¸‹
- è¿è¡Œæ°¸ä¹…ä¸¤æ¨¡å¼ï¼Œæµ‹è¯•ç”Ÿäº§ä¿å®‰å…¨