---
title: 10ã€SSHFSå®‰è£…é…ç½®ä¸ä½¿ç”¨
---
## ğŸ“š ç›®å½•

1. [SSHFSåŸºç¡€æ¦‚å¿µ](#1-SSHFSåŸºç¡€æ¦‚å¿µ)
2. [è½¯ä»¶åŒ…å®‰è£…](#2-è½¯ä»¶åŒ…å®‰è£…)
3. [SSHå¯†é’¥å…å¯†é…ç½®](#3-SSHå¯†é’¥å…å¯†é…ç½®)
4. [SSHFSå‘½ä»¤è¯¦è§£](#4-SSHFSå‘½ä»¤è¯¦è§£)
5. [æŒ‚è½½é€‰é¡¹ä¼˜åŒ–](#5-æŒ‚è½½é€‰é¡¹ä¼˜åŒ–)
6. [è‡ªåŠ¨é‡è¿æœºåˆ¶](#6-è‡ªåŠ¨é‡è¿æœºåˆ¶)
7. [æƒé™æ˜ å°„å¤„ç†](#7-æƒé™æ˜ å°„å¤„ç†)
8. [å¸è½½ä¸æ¸…ç†](#8-å¸è½½ä¸æ¸…ç†)
9. [æ€§èƒ½è°ƒä¼˜é…ç½®](#9-æ€§èƒ½è°ƒä¼˜é…ç½®)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ SSHFSåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SSHFS


**SSHFS**ï¼šSSH File Systemï¼ŒåŸºäºSSHåè®®çš„æ–‡ä»¶ç³»ç»Ÿ

```
æœ¬è´¨ç†è§£ï¼š
SSHFS = SSH + æ–‡ä»¶ç³»ç»Ÿ
é€šè¿‡SSHè¿æ¥å°†è¿œç¨‹ç›®å½•"æ˜ å°„"åˆ°æœ¬åœ°ï¼Œå°±åƒæœ¬åœ°ç£ç›˜ä¸€æ ·ä½¿ç”¨
```

**ğŸ”¸ æ ¸å¿ƒç‰¹ç‚¹**
- **åŸºäºSSH**ï¼šåˆ©ç”¨ç°æœ‰SSHè¿æ¥ï¼Œæ— éœ€é¢å¤–ç«¯å£
- **ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿ**ï¼šä¸éœ€è¦å†…æ ¸æ¨¡å—ï¼Œæ™®é€šç”¨æˆ·å°±èƒ½ä½¿ç”¨
- **é€æ˜è®¿é—®**ï¼šè¿œç¨‹ç›®å½•çœ‹èµ·æ¥å°±åƒæœ¬åœ°ç›®å½•
- **å®‰å…¨ä¼ è¾“**ï¼šæ‰€æœ‰æ•°æ®éƒ½ç»è¿‡SSHåŠ å¯†

### 1.2 SSHFSå·¥ä½œåŸç†


```
å·¥ä½œæµç¨‹å›¾ç¤ºï¼š

æœ¬åœ°åº”ç”¨ç¨‹åº
     â†“ (æ–‡ä»¶æ“ä½œ)
   SSHFSå®¢æˆ·ç«¯
     â†“ (SSHåè®®)
   ç½‘ç»œä¼ è¾“ (åŠ å¯†)
     â†“
   è¿œç¨‹SSHæœåŠ¡å™¨
     â†“ (æœ¬åœ°æ–‡ä»¶æ“ä½œ)
   è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿ
```

**ğŸ’¡ å·¥ä½œæœºåˆ¶è¯´æ˜**
```
å½“ä½ è®¿é—®æŒ‚è½½çš„ç›®å½•æ—¶ï¼š
1. åº”ç”¨ç¨‹åºè¯»å–æ–‡ä»¶ â†’ SSHFSæ‹¦æˆªæ“ä½œ
2. SSHFSé€šè¿‡SSHå‘é€è¯·æ±‚ â†’ è¿œç¨‹æœåŠ¡å™¨
3. è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œæ–‡ä»¶æ“ä½œ â†’ è¿”å›ç»“æœ
4. SSHFSæ¥æ”¶ç»“æœ â†’ è¿”å›ç»™åº”ç”¨ç¨‹åº

ç»“æœï¼šå°±åƒæ“ä½œæœ¬åœ°æ–‡ä»¶ä¸€æ ·è‡ªç„¶
```

### 1.3 SSHFS vs å…¶ä»–æ–‡ä»¶å…±äº«


| æ–¹å¼ | **ç«¯å£éœ€æ±‚** | **é…ç½®å¤æ‚åº¦** | **å®‰å…¨æ€§** | **æ€§èƒ½** |
|------|-------------|---------------|-----------|----------|
| **SSHFS** | `ä»…éœ€SSH(22)` | `ç®€å•` | `é«˜(SSHåŠ å¯†)` | `ä¸­ç­‰` |
| **NFS** | `å¤šä¸ªç«¯å£` | `å¤æ‚` | `è¾ƒä½` | `é«˜` |
| **Samba** | `445/139` | `ä¸­ç­‰` | `ä¸­ç­‰` | `é«˜` |
| **FTP** | `21+æ•°æ®ç«¯å£` | `ç®€å•` | `ä½(æ˜æ–‡)` | `ä¸­ç­‰` |

---

## 2. ğŸ“¦ è½¯ä»¶åŒ…å®‰è£…


### 2.1 æ£€æŸ¥ç³»ç»Ÿæ”¯æŒ


**æ£€æŸ¥FUSEæ”¯æŒ**ï¼ˆSSHFSåŸºäºFUSEï¼‰
```bash
# æ£€æŸ¥å†…æ ¸æ˜¯å¦æ”¯æŒFUSE
lsmod | grep fuse

# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œæ‰‹åŠ¨åŠ è½½
sudo modprobe fuse

# æ£€æŸ¥FUSEè®¾å¤‡
ls -l /dev/fuse
```

### 2.2 ä¸åŒå‘è¡Œç‰ˆå®‰è£…æ–¹æ³•


**ğŸ§ Ubuntu/Debianç³»åˆ—**
```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£…SSHFS
sudo apt install sshfs

# éªŒè¯å®‰è£…
sshfs --version
```

**ğŸ© CentOS/RHEL/Rocky Linux**
```bash
# CentOS 7/8
sudo yum install epel-release
sudo yum install sshfs

# Rocky Linux 9/CentOS Stream 9
sudo dnf install epel-release
sudo dnf install fuse-sshfs

# éªŒè¯å®‰è£…
sshfs --version
```

**ğŸ“¦ Arch Linux**
```bash
# å®‰è£…SSHFS
sudo pacman -S sshfs

# éªŒè¯å®‰è£…
sshfs --version
```

### 2.3 ä»æºç ç¼–è¯‘å®‰è£…


> âš ï¸ **æ³¨æ„**ï¼šä¸€èˆ¬æƒ…å†µä¸‹ç”¨åŒ…ç®¡ç†å™¨å®‰è£…å³å¯ï¼Œæºç ç¼–è¯‘ä»…åœ¨éœ€è¦ç‰¹å®šç‰ˆæœ¬æ—¶ä½¿ç”¨

```bash
# å®‰è£…ç¼–è¯‘ä¾èµ–
sudo apt install build-essential libfuse3-dev libglib2.0-dev

# ä¸‹è½½æºç 
wget https://github.com/libfuse/sshfs/archive/sshfs-3.7.3.tar.gz
tar -xzf sshfs-3.7.3.tar.gz
cd sshfs-sshfs-3.7.3

# ç¼–è¯‘å®‰è£…
./configure
make
sudo make install
```

---

## 3. ğŸ”‘ SSHå¯†é’¥å…å¯†é…ç½®


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦å¯†é’¥è®¤è¯


**å¯†ç è®¤è¯çš„é—®é¢˜**ï¼š
- æ¯æ¬¡æŒ‚è½½éƒ½è¦è¾“å…¥å¯†ç 
- è‡ªåŠ¨æŒ‚è½½è„šæœ¬æ— æ³•å·¥ä½œ
- å®‰å…¨æ€§ç›¸å¯¹è¾ƒä½

**å¯†é’¥è®¤è¯çš„ä¼˜åŠ¿**ï¼š
- ä¸€æ¬¡é…ç½®ï¼Œé•¿æœŸä½¿ç”¨
- æ”¯æŒè‡ªåŠ¨åŒ–è„šæœ¬
- æ›´é«˜çš„å®‰å…¨æ€§

### 3.2 ç”ŸæˆSSHå¯†é’¥å¯¹


```bash
# ç”Ÿæˆæ–°çš„å¯†é’¥å¯¹ï¼ˆæ¨èED25519ç®—æ³•ï¼‰
ssh-keygen -t ed25519 -C "your-email@example.com"

# æˆ–è€…ä½¿ç”¨RSAç®—æ³•ï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼‰
ssh-keygen -t rsa -b 4096 -C "your-email@example.com"

# æŒ‰æç¤ºæ“ä½œï¼š
# Enter file: ç›´æ¥å›è½¦ï¼ˆä½¿ç”¨é»˜è®¤è·¯å¾„ï¼‰
# Enter passphrase: å¯ä»¥è®¾ç½®æˆ–ç•™ç©º
```

**ğŸ”¸ å¯†é’¥æ–‡ä»¶è¯´æ˜**
```
~/.ssh/id_ed25519     # ç§é’¥ï¼ˆç»å¯¹ä¿å¯†ï¼‰
~/.ssh/id_ed25519.pub # å…¬é’¥ï¼ˆå¯ä»¥åˆ†äº«ï¼‰
```

### 3.3 éƒ¨ç½²å…¬é’¥åˆ°è¿œç¨‹æœåŠ¡å™¨


**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ssh-copy-idï¼ˆæ¨èï¼‰**
```bash
# å¤åˆ¶å…¬é’¥åˆ°è¿œç¨‹æœåŠ¡å™¨
ssh-copy-id username@remote-server

# æŒ‡å®šç‰¹å®šå¯†é’¥æ–‡ä»¶
ssh-copy-id -i ~/.ssh/id_ed25519.pub username@remote-server
```

**æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¤åˆ¶**
```bash
# æŸ¥çœ‹å…¬é’¥å†…å®¹
cat ~/.ssh/id_ed25519.pub

# ç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œæ·»åŠ åˆ°authorized_keys
echo "å…¬é’¥å†…å®¹" >> ~/.ssh/authorized_keys

# è®¾ç½®æ­£ç¡®æƒé™
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

### 3.4 æµ‹è¯•å…å¯†ç™»å½•


```bash
# æµ‹è¯•SSHå…å¯†ç™»å½•
ssh username@remote-server

# å¦‚æœæ— éœ€è¾“å…¥å¯†ç ç›´æ¥ç™»å½•ï¼Œè¯´æ˜é…ç½®æˆåŠŸ
# é€€å‡ºæµ‹è¯•
exit
```

---

## 4. ğŸ› ï¸ SSHFSå‘½ä»¤è¯¦è§£


### 4.1 åŸºæœ¬è¯­æ³•æ ¼å¼


```bash
sshfs [user@]hostname:[remote_directory] mountpoint [options]
```

**å‚æ•°è¯´æ˜**ï¼š
- `user@hostname`ï¼šè¿œç¨‹ç”¨æˆ·å’Œä¸»æœº
- `remote_directory`ï¼šè¿œç¨‹ç›®å½•è·¯å¾„
- `mountpoint`ï¼šæœ¬åœ°æŒ‚è½½ç‚¹
- `options`ï¼šæŒ‚è½½é€‰é¡¹

### 4.2 åŸºç¡€æŒ‚è½½ç¤ºä¾‹


**åˆ›å»ºæŒ‚è½½ç‚¹**
```bash
# åˆ›å»ºæœ¬åœ°æŒ‚è½½ç›®å½•
mkdir ~/remote-files

# ç¡®ä¿ç›®å½•ä¸ºç©º
ls ~/remote-files
```

**ç®€å•æŒ‚è½½**
```bash
# æŒ‚è½½è¿œç¨‹ç”¨æˆ·å®¶ç›®å½•
sshfs user@192.168.1.100: ~/remote-files

# æŒ‚è½½è¿œç¨‹æŒ‡å®šç›®å½•
sshfs user@192.168.1.100:/var/www ~/remote-files

# æŒ‚è½½ä½¿ç”¨åŸŸå
sshfs user@example.com:/home/user/documents ~/remote-files
```

### 4.3 å¸¸ç”¨æŒ‚è½½é€‰é¡¹


**ğŸ”¸ è¿æ¥ç›¸å…³é€‰é¡¹**
```bash
# æŒ‡å®šSSHç«¯å£
sshfs -p 2222 user@server: ~/remote-files

# æŒ‡å®šSSHå¯†é’¥æ–‡ä»¶
sshfs -o IdentityFile=~/.ssh/special_key user@server: ~/remote-files

# è®¾ç½®è¿æ¥è¶…æ—¶
sshfs -o ConnectTimeout=10 user@server: ~/remote-files
```

**ğŸ”¸ æƒé™æ˜ å°„é€‰é¡¹**
```bash
# æ˜ å°„ç”¨æˆ·IDå’Œç»„ID
sshfs -o uid=$(id -u),gid=$(id -g) user@server: ~/remote-files

# å…è®¸å…¶ä»–ç”¨æˆ·è®¿é—®
sshfs -o allow_other user@server: ~/remote-files

# è®¾ç½®é»˜è®¤æƒé™
sshfs -o default_permissions user@server: ~/remote-files
```

**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–é€‰é¡¹**
```bash
# å¯ç”¨å‹ç¼©ï¼ˆç½‘ç»œè¾ƒæ…¢æ—¶æœ‰ç”¨ï¼‰
sshfs -o compression=yes user@server: ~/remote-files

# è®¾ç½®ç¼“å­˜ç­–ç•¥
sshfs -o cache=yes user@server: ~/remote-files

# å¢å¤§è¯»å†™ç¼“å†²åŒº
sshfs -o kernel_cache,large_read user@server: ~/remote-files
```

### 4.4 ç»„åˆé€‰é¡¹ç¤ºä¾‹


```bash
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
sshfs user@server:/data ~/remote-data \
  -o reconnect,ServerAliveInterval=15,ServerAliveCountMax=3 \
  -o cache=yes,kernel_cache \
  -o uid=$(id -u),gid=$(id -g) \
  -o default_permissions

# é«˜å»¶è¿Ÿç½‘ç»œä¼˜åŒ–é…ç½®
sshfs user@server: ~/remote-files \
  -o compression=yes \
  -o cache=yes \
  -o kernel_cache \
  -o large_read \
  -o ConnectTimeout=30
```

---

## 5. âš™ï¸ æŒ‚è½½é€‰é¡¹ä¼˜åŒ–


### 5.1 ç¼“å­˜ç­–ç•¥é…ç½®


**ç¼“å­˜é€‰é¡¹è¯´æ˜**
```bash
# ç¦ç”¨ç¼“å­˜ï¼ˆé»˜è®¤ï¼Œæœ€å®‰å…¨ä½†æ€§èƒ½è¾ƒä½ï¼‰
-o cache=no

# å¯ç”¨åŸºæœ¬ç¼“å­˜ï¼ˆå¹³è¡¡æ€§èƒ½å’Œä¸€è‡´æ€§ï¼‰
-o cache=yes

# å¯ç”¨å†…æ ¸ç¼“å­˜ï¼ˆæœ€é«˜æ€§èƒ½ï¼Œä½†å¯èƒ½æœ‰ä¸€è‡´æ€§é—®é¢˜ï¼‰
-o kernel_cache
```

**ğŸ”¸ ç¼“å­˜é€‰æ‹©æŒ‡å¯¼**
- **å•ç”¨æˆ·è®¿é—®**ï¼šæ¨è `cache=yes` + `kernel_cache`
- **å¤šç”¨æˆ·å…±äº«**ï¼šæ¨è `cache=no` æˆ– `cache=yes`
- **åªè¯»è®¿é—®**ï¼šå¯ä»¥æ”¾å¿ƒä½¿ç”¨ `kernel_cache`

### 5.2 ç½‘ç»œä¼˜åŒ–é€‰é¡¹


**è¿æ¥ä¿æ´»é…ç½®**
```bash
# SSHè¿æ¥ä¿æ´»ï¼ˆé˜²æ­¢è¿æ¥æ–­å¼€ï¼‰
-o ServerAliveInterval=15    # æ¯15ç§’å‘é€ä¿æ´»åŒ…
-o ServerAliveCountMax=3     # è¿ç»­3æ¬¡æ— å“åº”åˆ™æ–­å¼€

# è‡ªåŠ¨é‡è¿
-o reconnect                 # è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨é‡è¿
```

**ä¼ è¾“ä¼˜åŒ–é…ç½®**
```bash
# å‹ç¼©ä¼ è¾“ï¼ˆé€‚åˆæ…¢é€Ÿç½‘ç»œï¼‰
-o compression=yes

# å¢å¤§è¯»å†™ç¼“å†²åŒº
-o large_read               # å¢å¤§è¯»ç¼“å†²åŒº
-o max_read=65536          # è®¾ç½®æœ€å¤§è¯»å–å¤§å°
```

### 5.3 å®Œæ•´ä¼˜åŒ–é…ç½®ç¤ºä¾‹


```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > ~/.sshfs_config << 'EOF'
# SSHFSä¼˜åŒ–é…ç½®
reconnect
ServerAliveInterval=15
ServerAliveCountMax=3
cache=yes
compression=yes
large_read
max_read=65536
ConnectTimeout=10
EOF

# ä½¿ç”¨é…ç½®æ–‡ä»¶æŒ‚è½½
sshfs -F ~/.sshfs_config user@server: ~/remote-files
```

---

## 6. ğŸ”„ è‡ªåŠ¨é‡è¿æœºåˆ¶


### 6.1 é‡è¿å‚æ•°è¯¦è§£


**æ ¸å¿ƒé‡è¿é€‰é¡¹**
```bash
-o reconnect                # å¯ç”¨è‡ªåŠ¨é‡è¿
-o ServerAliveInterval=N    # ä¿æ´»é—´éš”ï¼ˆç§’ï¼‰
-o ServerAliveCountMax=N    # æœ€å¤§å¤±è´¥æ¬¡æ•°
```

**ğŸ”¸ å‚æ•°è°ƒä¼˜å»ºè®®**
```
ç½‘ç»œç¯å¢ƒ                    æ¨èé…ç½®
å±€åŸŸç½‘(ç¨³å®š)               ServerAliveInterval=30, CountMax=3
å…¬ç½‘(ä¸€èˆ¬)                 ServerAliveInterval=15, CountMax=3  
ç§»åŠ¨ç½‘ç»œ(ä¸ç¨³å®š)           ServerAliveInterval=10, CountMax=5
```

### 6.2 é‡è¿ç›‘æ§è„šæœ¬


**æ£€æµ‹æŒ‚è½½çŠ¶æ€è„šæœ¬**
```bash
#!/bin/bash
# æ–‡ä»¶åï¼šcheck_sshfs_mount.sh

MOUNT_POINT="$HOME/remote-files"
REMOTE_HOST="user@server"

# æ£€æŸ¥æŒ‚è½½ç‚¹æ˜¯å¦æ­£å¸¸
if ! mountpoint -q "$MOUNT_POINT"; then
    echo "æŒ‚è½½ç‚¹ $MOUNT_POINT æœªæŒ‚è½½ï¼Œå°è¯•é‡æ–°æŒ‚è½½..."
    
    # æ¸…ç†å¯èƒ½çš„æ®‹ç•™æŒ‚è½½
    fusermount -u "$MOUNT_POINT" 2>/dev/null
    
    # é‡æ–°æŒ‚è½½
    sshfs "$REMOTE_HOST": "$MOUNT_POINT" \
        -o reconnect,ServerAliveInterval=15,ServerAliveCountMax=3 \
        -o cache=yes,compression=yes
    
    if mountpoint -q "$MOUNT_POINT"; then
        echo "é‡æ–°æŒ‚è½½æˆåŠŸ"
    else
        echo "é‡æ–°æŒ‚è½½å¤±è´¥"
        exit 1
    fi
else
    echo "æŒ‚è½½ç‚¹ $MOUNT_POINT æ­£å¸¸"
fi
```

**è®¾ç½®å®šæœŸæ£€æŸ¥**
```bash
# æ·»åŠ åˆ°crontabï¼Œæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
*/5 * * * * /path/to/check_sshfs_mount.sh >> /var/log/sshfs_monitor.log 2>&1
```

---

## 7. ğŸ‘¥ æƒé™æ˜ å°„å¤„ç†


### 7.1 æƒé™æ˜ å°„æ¦‚å¿µ


**æƒé™æ˜ å°„é—®é¢˜**ï¼š
```
æœ¬åœ°ç”¨æˆ·ID: 1000  â†’  è¿œç¨‹æœåŠ¡å™¨å¯èƒ½æ˜¯: 1001
æœ¬åœ°ç»„ID: 1000    â†’  è¿œç¨‹æœåŠ¡å™¨å¯èƒ½æ˜¯: 1001

æ²¡æœ‰æ˜ å°„ â†’ æƒé™é”™è¯¯ï¼Œæ— æ³•è®¿é—®æ–‡ä»¶
```

### 7.2 åŸºç¡€æƒé™æ˜ å°„


**æ˜ å°„åˆ°å½“å‰ç”¨æˆ·**
```bash
# å°†è¿œç¨‹æ–‡ä»¶çš„æ‰€æœ‰è€…æ˜ å°„åˆ°å½“å‰ç”¨æˆ·
sshfs -o uid=$(id -u),gid=$(id -g) user@server: ~/remote-files

# è§£é‡Šï¼š
# uid=$(id -u)  : è®¾ç½®æ–‡ä»¶æ‰€æœ‰è€…ä¸ºå½“å‰ç”¨æˆ·ID
# gid=$(id -g)  : è®¾ç½®æ–‡ä»¶ç»„ä¸ºå½“å‰ç”¨æˆ·çš„ç»„ID
```

**æŸ¥çœ‹ç”¨æˆ·å’Œç»„ID**
```bash
# æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¿¡æ¯
id

# è¾“å‡ºç¤ºä¾‹ï¼š
# uid=1000(username) gid=1000(username) groups=1000(username),4(adm),24(cdrom)...
```

### 7.3 é«˜çº§æƒé™é…ç½®


**å…è®¸å…¶ä»–ç”¨æˆ·è®¿é—®**
```bash
# éœ€è¦åœ¨/etc/fuse.confä¸­å¯ç”¨user_allow_other
echo "user_allow_other" | sudo tee -a /etc/fuse.conf

# æŒ‚è½½æ—¶æ·»åŠ allow_otheré€‰é¡¹
sshfs -o allow_other,uid=$(id -u),gid=$(id -g) user@server: ~/remote-files
```

**å¯ç”¨æƒé™æ£€æŸ¥**
```bash
# è®©ç³»ç»Ÿæ£€æŸ¥æƒé™ï¼ˆæ›´å®‰å…¨ï¼‰
sshfs -o default_permissions user@server: ~/remote-files
```

### 7.4 æƒé™é—®é¢˜æ’æŸ¥


**å¸¸è§æƒé™é—®é¢˜**
```bash
# é—®é¢˜1ï¼šæ— æ³•å†™å…¥æ–‡ä»¶
ls -la ~/remote-files/
# å¦‚æœæ˜¾ç¤ºæ‰€æœ‰è€…ä¸æ˜¯ä½ ï¼Œéœ€è¦æ·»åŠ uid/gidæ˜ å°„

# é—®é¢˜2ï¼šå…¶ä»–ç”¨æˆ·æ— æ³•è®¿é—®
# éœ€è¦æ·»åŠ allow_otheré€‰é¡¹

# é—®é¢˜3ï¼šæƒé™æ£€æŸ¥è¿‡äºä¸¥æ ¼
# è€ƒè™‘ç§»é™¤default_permissionsé€‰é¡¹
```

---

## 8. ğŸ”“ å¸è½½ä¸æ¸…ç†


### 8.1 æ­£å¸¸å¸è½½æ–¹æ³•


**æ ‡å‡†å¸è½½å‘½ä»¤**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨umount
umount ~/remote-files

# æ–¹æ³•2ï¼šä½¿ç”¨fusermountï¼ˆæ¨èï¼‰
fusermount -u ~/remote-files

# æ–¹æ³•3ï¼šä½¿ç”¨fusermount3ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
fusermount3 -u ~/remote-files
```

### 8.2 å¼ºåˆ¶å¸è½½æ–¹æ³•


**å¤„ç†å¸è½½å¤±è´¥**
```bash
# å¦‚æœæ™®é€šå¸è½½å¤±è´¥ï¼ŒæŸ¥çœ‹å ç”¨è¿›ç¨‹
lsof ~/remote-files

# å¼ºåˆ¶ç»“æŸå ç”¨è¿›ç¨‹
sudo fuser -km ~/remote-files

# æˆ–è€…ç›´æ¥å¼ºåˆ¶å¸è½½
fusermount -uz ~/remote-files

# æ‡’æƒ°å¸è½½ï¼ˆç«‹å³ä»å‘½åç©ºé—´ç§»é™¤ï¼Œä½†ç»§ç»­å¤„ç†å‰©ä½™æ“ä½œï¼‰
umount -l ~/remote-files
```

### 8.3 æ¸…ç†æ®‹ç•™é—®é¢˜


**æ£€æŸ¥æŒ‚è½½çŠ¶æ€**
```bash
# æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç‚¹
mount | grep sshfs

# æŸ¥çœ‹ç‰¹å®šæŒ‚è½½ç‚¹
mountpoint ~/remote-files

# å¦‚æœè¿”å›0ï¼Œè¯´æ˜ä»ç„¶æŒ‚è½½
echo $?
```

**æ¸…ç†æ­¥éª¤**
```bash
# 1. æ£€æŸ¥å¹¶ç»“æŸç›¸å…³è¿›ç¨‹
ps aux | grep sshfs

# 2. å¼ºåˆ¶å¸è½½
sudo umount -f ~/remote-files

# 3. æ¸…ç†å¯èƒ½çš„FUSEæ®‹ç•™
sudo fusermount -u ~/remote-files

# 4. éªŒè¯æ¸…ç†ç»“æœ
mountpoint ~/remote-files
```

### 8.4 è‡ªåŠ¨å¸è½½è„šæœ¬


```bash
#!/bin/bash
# æ–‡ä»¶åï¼šumount_sshfs.sh

MOUNT_POINT="$1"

if [ -z "$MOUNT_POINT" ]; then
    echo "ç”¨æ³•: $0 <æŒ‚è½½ç‚¹è·¯å¾„>"
    exit 1
fi

echo "æ­£åœ¨å¸è½½ $MOUNT_POINT ..."

# å°è¯•æ­£å¸¸å¸è½½
if fusermount -u "$MOUNT_POINT" 2>/dev/null; then
    echo "å¸è½½æˆåŠŸ"
    exit 0
fi

echo "æ­£å¸¸å¸è½½å¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶å¸è½½..."

# ç»“æŸå ç”¨è¿›ç¨‹
sudo fuser -km "$MOUNT_POINT" 2>/dev/null

# å¼ºåˆ¶å¸è½½
if sudo umount -f "$MOUNT_POINT" 2>/dev/null; then
    echo "å¼ºåˆ¶å¸è½½æˆåŠŸ"
else
    echo "å¼ºåˆ¶å¸è½½å¤±è´¥ï¼Œå¯èƒ½éœ€è¦é‡å¯ç³»ç»Ÿ"
    exit 1
fi
```

---

## 9. ğŸš€ æ€§èƒ½è°ƒä¼˜é…ç½®


### 9.1 æ€§èƒ½æµ‹è¯•åŸºå‡†


**æµ‹è¯•å·¥å…·å‡†å¤‡**
```bash
# å®‰è£…æ€§èƒ½æµ‹è¯•å·¥å…·
sudo apt install iozone3 fio

# åˆ›å»ºæµ‹è¯•ç›®å½•
mkdir ~/sshfs-test
```

**åŸºç¡€æ€§èƒ½æµ‹è¯•**
```bash
# ç®€å•çš„æ–‡ä»¶å¤åˆ¶æµ‹è¯•
time cp /dev/zero ~/remote-files/test_file bs=1M count=100

# åˆ é™¤æµ‹è¯•æ–‡ä»¶
rm ~/remote-files/test_file
```

### 9.2 ä¸åŒåœºæ™¯çš„ä¼˜åŒ–é…ç½®


**ğŸ”¸ å¤§æ–‡ä»¶ä¼ è¾“ä¼˜åŒ–**
```bash
sshfs user@server: ~/remote-files \
  -o cache=yes \
  -o kernel_cache \
  -o large_read \
  -o max_read=131072 \
  -o max_write=131072 \
  -o compression=no
```

**ğŸ”¸ å°æ–‡ä»¶é¢‘ç¹è®¿é—®ä¼˜åŒ–**
```bash
sshfs user@server: ~/remote-files \
  -o cache=yes \
  -o kernel_cache \
  -o entry_timeout=60 \
  -o attr_timeout=60 \
  -o compression=yes
```

**ğŸ”¸ ç½‘ç»œå¸¦å®½å—é™ä¼˜åŒ–**
```bash
sshfs user@server: ~/remote-files \
  -o compression=yes \
  -o cache=yes \
  -o max_read=32768 \
  -o max_write=32768
```

### 9.3 é«˜çº§è°ƒä¼˜å‚æ•°


**ç¼“å­˜æ—¶é—´æ§åˆ¶**
```bash
# å±æ€§ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
-o attr_timeout=N       # æ–‡ä»¶å±æ€§ç¼“å­˜æ—¶é—´
-o entry_timeout=N      # ç›®å½•é¡¹ç¼“å­˜æ—¶é—´
-o negative_timeout=N   # è´Ÿç¼“å­˜æ—¶é—´ï¼ˆä¸å­˜åœ¨çš„æ–‡ä»¶ï¼‰
```

**è¯»å†™ç¼“å†²åŒºè°ƒä¼˜**
```bash
# è¯»å†™ç¼“å†²åŒºå¤§å°
-o max_read=N          # æœ€å¤§è¯»å–å—å¤§å°
-o max_write=N         # æœ€å¤§å†™å…¥å—å¤§å°
-o readahead=N         # é¢„è¯»å–å¤§å°
```

### 9.4 æ€§èƒ½ç›‘æ§æ–¹æ³•


**ç›‘æ§æŒ‚è½½ç‚¹çŠ¶æ€**
```bash
# æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
cat /proc/filesystems | grep fuse

# æŸ¥çœ‹SSHFSè¿›ç¨‹çŠ¶æ€
ps aux | grep sshfs

# æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€
netstat -an | grep :22
```

**æ€§èƒ½åˆ†æå·¥å…·**
```bash
# ä½¿ç”¨iotopç›‘æ§IO
sudo iotop -o

# ä½¿ç”¨nethogsç›‘æ§ç½‘ç»œä½¿ç”¨
sudo nethogs

# æŸ¥çœ‹æŒ‚è½½ç‚¹IOç»Ÿè®¡
iostat -x 1
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ SSHFSæœ¬è´¨ï¼šåŸºäºSSHçš„ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿï¼Œå°†è¿œç¨‹ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°
ğŸ”¸ å·¥ä½œåŸç†ï¼šé€šè¿‡SSHè¿æ¥è½¬å‘æ–‡ä»¶æ“ä½œï¼Œæ‰€æœ‰æ•°æ®åŠ å¯†ä¼ è¾“
ğŸ”¸ å®‰è£…æ–¹æ³•ï¼šå„å‘è¡Œç‰ˆéƒ½æœ‰ç°æˆè½¯ä»¶åŒ…ï¼Œç›´æ¥ç”¨åŒ…ç®¡ç†å™¨å®‰è£…
ğŸ”¸ å¯†é’¥é…ç½®ï¼šé…ç½®SSHå…å¯†ç™»å½•æ˜¯ä½¿ç”¨SSHFSçš„å‰æ
ğŸ”¸ åŸºæœ¬ç”¨æ³•ï¼šsshfs user@host:/path /local/mount/point
```

### 10.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ å¿…å¤‡ä¼˜åŒ–é€‰é¡¹**
```bash
# åŸºç¡€é…ç½®ï¼ˆé€‚åˆå¤§å¤šæ•°æƒ…å†µï¼‰
-o reconnect,ServerAliveInterval=15,ServerAliveCountMax=3
-o cache=yes,uid=$(id -u),gid=$(id -g)

# é«˜æ€§èƒ½é…ç½®ï¼ˆé€‚åˆç¨³å®šç½‘ç»œï¼‰
-o kernel_cache,large_read,compression=yes

# å¤šç”¨æˆ·é…ç½®ï¼ˆéœ€è¦å…±äº«è®¿é—®ï¼‰
-o allow_other,default_permissions
```

**ğŸ”¹ æƒé™æ˜ å°„è¦ç‚¹**
```
é—®é¢˜ï¼šè¿œç¨‹æ–‡ä»¶çš„ç”¨æˆ·IDå¯èƒ½ä¸æœ¬åœ°ä¸åŒ
è§£å†³ï¼šä½¿ç”¨ uid=$(id -u),gid=$(id -g) æ˜ å°„åˆ°å½“å‰ç”¨æˆ·
å…±äº«ï¼šéœ€è¦ allow_other é€‰é¡¹è®©å…¶ä»–ç”¨æˆ·è®¿é—®
```

**ğŸ”¹ å¸è½½æ¸…ç†è¦ç‚¹**
```
æ­£å¸¸å¸è½½ï¼šfusermount -u /mount/point
å¼ºåˆ¶å¸è½½ï¼šfusermount -uz /mount/point  
é—®é¢˜æ’æŸ¥ï¼šä½¿ç”¨ lsof æŸ¥çœ‹å ç”¨è¿›ç¨‹
```

### 10.3 å®é™…åº”ç”¨åœºæ™¯


- **è¿œç¨‹å¼€å‘**ï¼šæŒ‚è½½è¿œç¨‹æœåŠ¡å™¨ä»£ç ç›®å½•ï¼Œæœ¬åœ°ç¼–è¾‘å™¨ç›´æ¥è®¿é—®
- **å¤‡ä»½åŒæ­¥**ï¼šå°†è¿œç¨‹å¤‡ä»½ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿æ•°æ®ç®¡ç†  
- **æ–‡ä»¶å…±äº«**ï¼šå›¢é˜Ÿæˆå‘˜å…±äº«è¿œç¨‹æ–‡ä»¶æœåŠ¡å™¨ä¸Šçš„èµ„æº
- **æ—¥å¿—åˆ†æ**ï¼šæŒ‚è½½è¿œç¨‹æœåŠ¡å™¨æ—¥å¿—ç›®å½•ï¼Œæœ¬åœ°å·¥å…·åˆ†æ
- **åª’ä½“æœåŠ¡**ï¼šè®¿é—®è¿œç¨‹åª’ä½“æœåŠ¡å™¨ä¸Šçš„éŸ³è§†é¢‘æ–‡ä»¶

### 10.4 æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ


**âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹**
- SSHFSæ€§èƒ½ä¸å¦‚NFSï¼Œä¸é€‚åˆé«˜IOåœºæ™¯
- ç½‘ç»œæ–­å¼€ä¼šå¯¼è‡´æŒ‚è½½å¤±æ•ˆï¼Œéœ€è¦é…ç½®è‡ªåŠ¨é‡è¿
- æƒé™æ˜ å°„è¦æ­£ç¡®é…ç½®ï¼Œå¦åˆ™å¯èƒ½æ— æ³•è®¿é—®æ–‡ä»¶
- ä¸è¦åœ¨æŒ‚è½½ç‚¹å†…åˆ›å»ºæŒ‚è½½ç‚¹ï¼Œé¿å…åµŒå¥—é—®é¢˜

**âœ… æœ€ä½³å®è·µå»ºè®®**
- æ€»æ˜¯é…ç½®SSHå¯†é’¥å…å¯†ç™»å½•
- æ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´ä¿æ´»å‚æ•°
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å†™å…¥/etc/fstabå®ç°å¼€æœºè‡ªåŠ¨æŒ‚è½½
- å®šæœŸç›‘æ§æŒ‚è½½çŠ¶æ€ï¼Œé…ç½®è‡ªåŠ¨é‡è¿è„šæœ¬

**æ ¸å¿ƒè®°å¿†**ï¼š
- SSHFSè®©è¿œç¨‹ç›®å½•å¦‚åŒæœ¬åœ°ï¼ŒSSHåè®®ä¿å®‰å…¨
- å¯†é’¥è®¤è¯å…å¯†ç ï¼Œæƒé™æ˜ å°„è¦é…å¥½
- é‡è¿ç¼“å­˜ææ€§èƒ½ï¼Œå¸è½½æ¸…ç†åˆ«å¿˜äº†
- é€‚åˆè½»é‡æ–‡ä»¶è®¿é—®ï¼Œé‡IOåœºæ™¯éœ€æ…é‡