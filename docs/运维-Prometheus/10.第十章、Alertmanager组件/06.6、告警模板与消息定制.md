---
title: 6ã€å‘Šè­¦æ¨¡æ¿ä¸æ¶ˆæ¯å®šåˆ¶
---
## ğŸ“š ç›®å½•

1. [å‘Šè­¦æ¨¡æ¿åŸºç¡€æ¦‚å¿µ](#1-å‘Šè­¦æ¨¡æ¿åŸºç¡€æ¦‚å¿µ)
2. [Goæ¨¡æ¿è¯­æ³•å…¥é—¨](#2-Goæ¨¡æ¿è¯­æ³•å…¥é—¨)
3. [å‘Šè­¦å¯¹è±¡ä¸æ•°æ®è®¿é—®](#3-å‘Šè­¦å¯¹è±¡ä¸æ•°æ®è®¿é—®)
4. [æ—¶é—´æ ¼å¼åŒ–ä¸URLæ„å»º](#4-æ—¶é—´æ ¼å¼åŒ–ä¸URLæ„å»º)
5. [æ¡ä»¶åˆ¤æ–­ä¸å¾ªç¯æ§åˆ¶](#5-æ¡ä»¶åˆ¤æ–­ä¸å¾ªç¯æ§åˆ¶)
6. [é«˜çº§æ¨¡æ¿åŠŸèƒ½](#6-é«˜çº§æ¨¡æ¿åŠŸèƒ½)
7. [æ¨¡æ¿æœ€ä½³å®è·µ](#7-æ¨¡æ¿æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ å‘Šè­¦æ¨¡æ¿åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å‘Šè­¦æ¨¡æ¿


**ç®€å•ç†è§£**ï¼šå‘Šè­¦æ¨¡æ¿å°±åƒæ˜¯ä¸€ä¸ª**æ¶ˆæ¯æ ¼å¼çš„æ¨¡å…·**ï¼Œå†³å®šäº†å‘Šè­¦é€šçŸ¥é•¿ä»€ä¹ˆæ ·

```
æ²¡æœ‰æ¨¡æ¿çš„åŸå§‹å‘Šè­¦ï¼š
AlertName: disk_full
Instance: server1:9100
Value: 95.5

ä½¿ç”¨æ¨¡æ¿åçš„å‘Šè­¦ï¼š
ğŸš¨ ç£ç›˜ç©ºé—´å‘Šè­¦
æœåŠ¡å™¨ server1 çš„ç£ç›˜ä½¿ç”¨ç‡å·²è¾¾åˆ° 95.5%ï¼Œè¯·ç«‹å³å¤„ç†ï¼
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **æ ¼å¼åŒ–æ¶ˆæ¯**ï¼šæŠŠæœºå™¨æ•°æ®å˜æˆäººèƒ½ç†è§£çš„æ–‡å­—
- **å®šåˆ¶å¤–è§‚**ï¼šæ§åˆ¶å‘Šè­¦çš„æ ‡é¢˜ã€å†…å®¹ã€é¢œè‰²ç­‰
- **æ·»åŠ ä¿¡æ¯**ï¼šè¡¥å……å¸®åŠ©é“¾æ¥ã€å¤„ç†å»ºè®®ç­‰
- **å¤šæ¸ é“é€‚é…**ï¼šåŒä¸€å‘Šè­¦åœ¨é‚®ä»¶ã€å¾®ä¿¡ã€é’‰é’‰æ˜¾ç¤ºä¸åŒæ ¼å¼

### 1.2 æ¨¡æ¿çš„å·¥ä½œåŸç†


**å·¥ä½œæµç¨‹å›¾**ï¼š
```
Prometheuså‘Šè­¦ â†’ Alertmanager â†’ åº”ç”¨æ¨¡æ¿ â†’ æ ¼å¼åŒ–æ¶ˆæ¯ â†’ å‘é€é€šçŸ¥
     â†“              â†“           â†“            â†“           â†“
   åŸå§‹æ•°æ®        è§£ææ•°æ®     å¥—ç”¨æ¨¡æ¿      ç¾åŒ–æ¶ˆæ¯     æ¨é€ç”¨æˆ·
```

**å¤„ç†è¿‡ç¨‹**ï¼š
1. **æ¥æ”¶åŸå§‹å‘Šè­¦**ï¼šAlertmanageræ”¶åˆ°Prometheusçš„å‘Šè­¦æ•°æ®
2. **æ•°æ®è§£æ**ï¼šæå–å‘Šè­¦çš„æ ‡ç­¾ã€æ³¨é‡Šã€çŠ¶æ€ç­‰ä¿¡æ¯
3. **æ¨¡æ¿åŒ¹é…**ï¼šæ ¹æ®é…ç½®é€‰æ‹©åˆé€‚çš„æ¨¡æ¿
4. **å†…å®¹ç”Ÿæˆ**ï¼šç”¨å‘Šè­¦æ•°æ®å¡«å……æ¨¡æ¿ï¼Œç”Ÿæˆæœ€ç»ˆæ¶ˆæ¯
5. **å‘é€é€šçŸ¥**ï¼šå°†æ ¼å¼åŒ–åçš„æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šæ¸ é“

### 1.3 æ¨¡æ¿æ–‡ä»¶ç»“æ„


**åŸºæœ¬ç›®å½•ç»“æ„**ï¼š
```
/etc/alertmanager/
â”œâ”€â”€ alertmanager.yml          # ä¸»é…ç½®æ–‡ä»¶
â””â”€â”€ templates/                # æ¨¡æ¿ç›®å½•
    â”œâ”€â”€ default.tmpl         # é»˜è®¤æ¨¡æ¿
    â”œâ”€â”€ email.tmpl           # é‚®ä»¶ä¸“ç”¨æ¨¡æ¿
    â”œâ”€â”€ wechat.tmpl          # å¾®ä¿¡æ¨¡æ¿
    â””â”€â”€ slack.tmpl           # Slackæ¨¡æ¿
```

**æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹**ï¼š
```go
{{ define "email.subject" }}
[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }}å‘Šè­¦
{{ end }}

{{ define "email.html" }}
<h2>å‘Šè­¦è¯¦æƒ…</h2>
<p>å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}</p>
<p>å‘Šè­¦çŠ¶æ€ï¼š{{ .Status }}</p>
{{ end }}
```

---

## 2. ğŸ”§ Goæ¨¡æ¿è¯­æ³•å…¥é—¨


### 2.1 æ¨¡æ¿è¯­æ³•åŸºç¡€


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šAlertmanagerä½¿ç”¨Goè¯­è¨€çš„`text/template`åŒ…ï¼Œè¯­æ³•ç®€æ´ä½†åŠŸèƒ½å¼ºå¤§

**åŸºæœ¬è¯­æ³•ç»“æ„**ï¼š
```go
{{ è¡¨è¾¾å¼ }}              # è¾“å‡ºå˜é‡æˆ–å‡½æ•°ç»“æœ
{{- è¡¨è¾¾å¼ -}}            # å»é™¤å‰åç©ºç™½å­—ç¬¦
{{ /* æ³¨é‡Šå†…å®¹ */ }}      # æ¨¡æ¿æ³¨é‡Š
{{ define "æ¨¡æ¿å" }} ... {{ end }}  # å®šä¹‰å­æ¨¡æ¿
```

### 2.2 å˜é‡è®¿é—®è¯­æ³•


**è®¿é—®å‘Šè­¦æ•°æ®çš„æ–¹å¼**ï¼š

| **è¯­æ³•** | **å«ä¹‰** | **ç¤ºä¾‹** |
|---------|---------|---------|
| `{{ .Status }}` | å‘Šè­¦çŠ¶æ€ | `firing` æˆ– `resolved` |
| `{{ .GroupLabels.alertname }}` | å‘Šè­¦åç§° | `disk_full` |
| `{{ .CommonLabels.instance }}` | å®ä¾‹æ ‡è¯† | `server1:9100` |
| `{{ .CommonAnnotations.summary }}` | å‘Šè­¦æ‘˜è¦ | `ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜` |

**å®é™…ç¤ºä¾‹**ï¼š
```go
å‘Šè­¦çŠ¶æ€ï¼š{{ .Status }}
å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}
å½±å“å®ä¾‹ï¼š{{ .CommonLabels.instance }}
å‘Šè­¦æ‘˜è¦ï¼š{{ .CommonAnnotations.summary }}
```

**è¾“å‡ºç»“æœ**ï¼š
```
å‘Šè­¦çŠ¶æ€ï¼šfiring
å‘Šè­¦åç§°ï¼šdisk_full
å½±å“å®ä¾‹ï¼šserver1:9100
å‘Šè­¦æ‘˜è¦ï¼šç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜
```

### 2.3 å†…ç½®å‡½æ•°ä½¿ç”¨


**å¸¸ç”¨çš„æ ¼å¼åŒ–å‡½æ•°**ï¼š

```go
{{ .Status | toUpper }}              # è½¬å¤§å†™ï¼šFIRING
{{ .Status | toLower }}              # è½¬å°å†™ï¼šfiring  
{{ .Status | title }}                # é¦–å­—æ¯å¤§å†™ï¼šFiring
{{ .CommonAnnotations.summary | html }}  # HTMLè½¬ä¹‰
{{ .Alerts | len }}                  # è·å–å‘Šè­¦æ•°é‡
```

**å­—ç¬¦ä¸²å¤„ç†å‡½æ•°**ï¼š
```go
{{ .GroupLabels.alertname | replace "_" " " }}  # æ›¿æ¢å­—ç¬¦
{{ .CommonLabels.instance | split ":" }}        # åˆ†å‰²å­—ç¬¦ä¸²
{{ printf "%.2f" .Value }}                      # æ ¼å¼åŒ–æ•°å­—
```

---

## 3. ğŸ“Š å‘Šè­¦å¯¹è±¡ä¸æ•°æ®è®¿é—®


### 3.1 å‘Šè­¦æ•°æ®ç»“æ„


**Alertmanagerä¸­çš„å‘Šè­¦å¯¹è±¡ç»“æ„**ï¼š
```
å‘Šè­¦ç»„ (Alert Group)
â”œâ”€â”€ Status           # ç»„çŠ¶æ€ (firing/resolved)
â”œâ”€â”€ GroupLabels      # åˆ†ç»„æ ‡ç­¾
â”œâ”€â”€ CommonLabels     # å…±åŒæ ‡ç­¾  
â”œâ”€â”€ CommonAnnotations # å…±åŒæ³¨é‡Š
â”œâ”€â”€ ExternalURL      # å¤–éƒ¨é“¾æ¥
â””â”€â”€ Alerts[]         # å…·ä½“å‘Šè­¦åˆ—è¡¨
    â”œâ”€â”€ Status       # å•ä¸ªå‘Šè­¦çŠ¶æ€
    â”œâ”€â”€ Labels       # å‘Šè­¦æ ‡ç­¾
    â”œâ”€â”€ Annotations  # å‘Šè­¦æ³¨é‡Š
    â”œâ”€â”€ StartsAt     # å¼€å§‹æ—¶é—´
    â”œâ”€â”€ EndsAt       # ç»“æŸæ—¶é—´
    â””â”€â”€ GeneratorURL # ç”Ÿæˆé“¾æ¥
```

### 3.2 æ ‡ç­¾æ•°æ®è®¿é—®


**æ ‡ç­¾çš„ä½œç”¨å’Œè®¿é—®æ–¹å¼**ï¼š

> ğŸ’¡ **æ ‡ç­¾å«ä¹‰**ï¼šæ ‡ç­¾æ˜¯å‘Šè­¦çš„"èº«ä»½è¯"ï¼ŒåŒ…å«äº†å‘Šè­¦çš„å…³é”®è¯†åˆ«ä¿¡æ¯

```go
# è®¿é—®åˆ†ç»„æ ‡ç­¾ï¼ˆç”¨äºå‘Šè­¦åˆ†ç»„çš„æ ‡ç­¾ï¼‰
{{ .GroupLabels.alertname }}         # å‘Šè­¦åç§°
{{ .GroupLabels.service }}           # æœåŠ¡åç§°

# è®¿é—®å…±åŒæ ‡ç­¾ï¼ˆæ‰€æœ‰å‘Šè­¦å…±æœ‰çš„æ ‡ç­¾ï¼‰  
{{ .CommonLabels.instance }}         # å®ä¾‹åœ°å€
{{ .CommonLabels.job }}              # ä»»åŠ¡åç§°
{{ .CommonLabels.severity }}         # ä¸¥é‡çº§åˆ«

# è®¿é—®å•ä¸ªå‘Šè­¦çš„æ ‡ç­¾
{{ range .Alerts }}
  å®ä¾‹ï¼š{{ .Labels.instance }}
  ä»»åŠ¡ï¼š{{ .Labels.job }}
{{ end }}
```

**å®ç”¨ç¤ºä¾‹**ï¼š
```go
{{ define "alert.title" }}
{{ if eq .Status "firing" }}ğŸš¨{{ else }}âœ…{{ end }} 
{{ .GroupLabels.alertname | replace "_" " " | title }}å‘Šè­¦
{{ end }}
```

### 3.3 æ³¨é‡Šä¿¡æ¯å¤„ç†


**æ³¨é‡Švsæ ‡ç­¾çš„åŒºåˆ«**ï¼š
- **æ ‡ç­¾**ï¼šç”¨äºåˆ†ç»„å’Œè·¯ç”±ï¼Œç®€çŸ­çš„é”®å€¼å¯¹
- **æ³¨é‡Š**ï¼šç”¨äºæè¿°å’Œå±•ç¤ºï¼Œå¯ä»¥æ˜¯é•¿æ–‡æœ¬

```go
# è®¿é—®å…±åŒæ³¨é‡Š
{{ .CommonAnnotations.summary }}      # å‘Šè­¦æ‘˜è¦  
{{ .CommonAnnotations.description }}  # è¯¦ç»†æè¿°
{{ .CommonAnnotations.runbook_url }}  # å¤„ç†æ‰‹å†Œé“¾æ¥

# è®¿é—®å•ä¸ªå‘Šè­¦æ³¨é‡Š
{{ range .Alerts }}
æ‘˜è¦ï¼š{{ .Annotations.summary }}
æè¿°ï¼š{{ .Annotations.description }}
{{ end }}
```

**æ³¨é‡Šæ ¼å¼åŒ–ç¤ºä¾‹**ï¼š
```go
{{ define "alert.description" }}
{{ if .CommonAnnotations.description }}
ğŸ“‹ **è¯¦ç»†æè¿°**
{{ .CommonAnnotations.description }}
{{ end }}

{{ if .CommonAnnotations.runbook_url }}
ğŸ“– **å¤„ç†æ‰‹å†Œ**ï¼š{{ .CommonAnnotations.runbook_url }}
{{ end }}
{{ end }}
```

---

## 4. â° æ—¶é—´æ ¼å¼åŒ–ä¸URLæ„å»º


### 4.1 æ—¶é—´å¤„ç†å‡½æ•°


**æ—¶é—´ç›¸å…³çš„æ¨¡æ¿å‡½æ•°**ï¼š

```go
# æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
{{ .Alerts.StartsAt.Format "2006-01-02 15:04:05" }}  # æ ‡å‡†æ ¼å¼
{{ .Alerts.StartsAt.Format "01-02 15:04" }}          # ç®€çŸ­æ ¼å¼
{{ .Alerts.StartsAt.Local.Format "15:04:05" }}       # æœ¬åœ°æ—¶é—´

# è®¡ç®—æ—¶é—´å·®
{{ $duration := .Alerts.StartsAt.Sub .Alerts.EndsAt }}
æŒç»­æ—¶é—´ï¼š{{ $duration }}
```

**å¸¸ç”¨æ—¶é—´æ ¼å¼**ï¼š
```go
{{ define "time.formats" }}
å®Œæ•´æ—¶é—´ï¼š{{ .StartsAt.Format "2006å¹´01æœˆ02æ—¥ 15:04:05" }}
ç®€æ´æ—¶é—´ï¼š{{ .StartsAt.Format "01-02 15:04" }}  
ä»…æ—¥æœŸï¼š{{ .StartsAt.Format "2006-01-02" }}
ä»…æ—¶é—´ï¼š{{ .StartsAt.Format "15:04:05" }}
{{ end }}
```

> âš ï¸ **Goæ—¶é—´æ ¼å¼æ³¨æ„**ï¼šGoä½¿ç”¨å›ºå®šçš„å‚è€ƒæ—¶é—´ `2006-01-02 15:04:05` ä½œä¸ºæ ¼å¼æ¨¡æ¿

### 4.2 URLæ„å»ºæŠ€å·§


**æ„å»ºæœ‰ç”¨çš„é“¾æ¥**ï¼š

```go
# PrometheusæŸ¥è¯¢é“¾æ¥
{{ $expr := printf "up{instance=\"%s\"}" .CommonLabels.instance }}
{{ $url := printf "%s/graph?g0.expr=%s" .ExternalURL $expr }}
ğŸ“Š **ç›‘æ§å›¾è¡¨**ï¼š{{ $url }}

# Grafanaä»ªè¡¨æ¿é“¾æ¥  
{{ $dashboard := printf "http://grafana:3000/d/system?var-instance=%s" .CommonLabels.instance }}
ğŸ“ˆ **ç³»ç»Ÿç›‘æ§**ï¼š{{ $dashboard }}

# æ—¥å¿—æŸ¥è¯¢é“¾æ¥
{{ $logUrl := printf "http://kibana:5601/app/discover#/?_g=(time:(from:now-1h,to:now))&_a=(query:(query:'host:%s'))" .CommonLabels.instance }}
ğŸ“‹ **ç›¸å…³æ—¥å¿—**ï¼š{{ $logUrl }}
```

**URLç¼–ç å¤„ç†**ï¼š
```go
{{ $query := .CommonLabels.instance | urlquery }}
æœç´¢é“¾æ¥ï¼šhttp://example.com/search?q={{ $query }}
```

---

## 5. ğŸ”€ æ¡ä»¶åˆ¤æ–­ä¸å¾ªç¯æ§åˆ¶


### 5.1 æ¡ä»¶åˆ¤æ–­è¯­å¥


**åŸºæœ¬ifè¯­å¥**ï¼š
```go
{{ if eq .Status "firing" }}
ğŸš¨ **å‘Šè­¦è§¦å‘**
{{ else }}
âœ… **å‘Šè­¦æ¢å¤**  
{{ end }}
```

**å¤šæ¡ä»¶åˆ¤æ–­**ï¼š
```go
{{ if eq .CommonLabels.severity "critical" }}
ğŸ”´ **ä¸¥é‡å‘Šè­¦**
{{ else if eq .CommonLabels.severity "warning" }}
ğŸŸ¡ **è­¦å‘Šçº§åˆ«**
{{ else }}
ğŸ”µ **ä¿¡æ¯æç¤º**
{{ end }}
```

**å¤æ‚æ¡ä»¶ç»„åˆ**ï¼š
```go
{{ if and (eq .Status "firing") (eq .CommonLabels.severity "critical") }}
ğŸ’¥ **ç´§æ€¥æƒ…å†µ**ï¼šè¯·ç«‹å³å¤„ç†ï¼
{{ else if eq .Status "resolved" }}
âœ… **é—®é¢˜å·²è§£å†³**
{{ else }}
â„¹ï¸ **å¸¸è§„å‘Šè­¦**
{{ end }}
```

### 5.2 å¾ªç¯éå†è¯­å¥


**éå†æ‰€æœ‰å‘Šè­¦**ï¼š
```go
{{ range .Alerts }}
---
ğŸ“ **å®ä¾‹**ï¼š{{ .Labels.instance }}
ğŸ•’ **å¼€å§‹æ—¶é—´**ï¼š{{ .StartsAt.Format "01-02 15:04" }}
ğŸ“ **æ‘˜è¦**ï¼š{{ .Annotations.summary }}
{{ end }}
```

**å¸¦ç´¢å¼•çš„å¾ªç¯**ï¼š
```go
{{ range $i, $alert := .Alerts }}
{{ $i | add 1 }}. {{ $alert.Labels.instance }}
{{ end }}
```

**å¾ªç¯ä¸­çš„æ¡ä»¶åˆ¤æ–­**ï¼š
```go
{{ range .Alerts }}
{{ if eq .Labels.severity "critical" }}
ğŸ”´ **ä¸¥é‡**ï¼š{{ .Labels.instance }} - {{ .Annotations.summary }}
{{ end }}
{{ end }}
```

### 5.3 å˜é‡å®šä¹‰ä¸ä½¿ç”¨


**å®šä¹‰ä¸´æ—¶å˜é‡**ï¼š
```go
{{ $alertCount := len .Alerts }}
{{ $criticalCount := 0 }}
{{ range .Alerts }}
  {{ if eq .Labels.severity "critical" }}
    {{ $criticalCount = add $criticalCount 1 }}
  {{ end }}
{{ end }}

ğŸ“Š **ç»Ÿè®¡ä¿¡æ¯**
- æ€»å‘Šè­¦æ•°ï¼š{{ $alertCount }}
- ä¸¥é‡å‘Šè­¦ï¼š{{ $criticalCount }}
```

---

## 6. ğŸ¨ é«˜çº§æ¨¡æ¿åŠŸèƒ½


### 6.1 è‡ªå®šä¹‰å‡½æ•°


**å®šä¹‰å¤ç”¨å‡½æ•°**ï¼š
```go
{{ define "severity.icon" }}
{{ if eq . "critical" }}ğŸ”´
{{ else if eq . "warning" }}ğŸŸ¡  
{{ else if eq . "info" }}ğŸ”µ
{{ else }}âšª{{ end }}
{{ end }}

{{ define "status.icon" }}
{{ if eq . "firing" }}ğŸš¨{{ else }}âœ…{{ end }}
{{ end }}
```

**ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°**ï¼š
```go
{{ template "status.icon" .Status }} {{ template "severity.icon" .CommonLabels.severity }}
å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}
```

### 6.2 æ¨¡æ¿ç»§æ‰¿ä¸ç»„åˆ


**ä¸»æ¨¡æ¿å®šä¹‰**ï¼š
```go
{{ define "email.subject" }}
{{ template "status.icon" .Status }} {{ .GroupLabels.alertname }}
{{ end }}

{{ define "email.html" }}
<html>
<body>
{{ template "alert.header" . }}
{{ template "alert.content" . }}  
{{ template "alert.footer" . }}
</body>
</html>
{{ end }}
```

**å­æ¨¡æ¿å®ç°**ï¼š
```go
{{ define "alert.header" }}
<h2>{{ template "status.icon" .Status }} å‘Šè­¦é€šçŸ¥</h2>
<hr>
{{ end }}

{{ define "alert.content" }}
<table>
{{ range .Alerts }}
<tr>
  <td>{{ .Labels.instance }}</td>
  <td>{{ .Annotations.summary }}</td>
</tr>
{{ end }}
</table>
{{ end }}
```

### 6.3 å¤šè¯­è¨€æ¨¡æ¿æ”¯æŒ


**ä¸­è‹±æ–‡æ¨¡æ¿**ï¼š
```go
{{ define "alert.title.zh" }}
{{ template "status.icon" .Status }} {{ .GroupLabels.alertname }}å‘Šè­¦
{{ end }}

{{ define "alert.title.en" }}  
{{ template "status.icon" .Status }} {{ .GroupLabels.alertname }} Alert
{{ end }}

{{ define "alert.message" }}
{{ if eq .CommonLabels.lang "en" }}
{{ template "alert.title.en" . }}
{{ else }}
{{ template "alert.title.zh" . }}
{{ end }}
{{ end }}
```

---

## 7. ğŸ† æ¨¡æ¿æœ€ä½³å®è·µ


### 7.1 æ¨¡æ¿è°ƒè¯•æŠ€å·§


**è°ƒè¯•æ­¥éª¤**ï¼š

```bash
# 1. éªŒè¯æ¨¡æ¿è¯­æ³•
amtool template --template.file=template.tmpl --template.data=test.json

# 2. æµ‹è¯•æ¨¡æ¿è¾“å‡º
curl -X POST http://localhost:9093/api/v1/alerts \
  -H "Content-Type: application/json" \
  -d @test_alert.json
```

**è°ƒè¯•æ¨¡æ¿ç¤ºä¾‹**ï¼š
```go
{{ define "debug.template" }}
DEBUGä¿¡æ¯ï¼š
- Status: {{ .Status }}
- GroupLabels: {{ .GroupLabels }}
- å‘Šè­¦æ•°é‡: {{ len .Alerts }}
{{ range $key, $value := .CommonLabels }}
- {{ $key }}: {{ $value }}
{{ end }}
{{ end }}
```

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ä¼˜åŒ–è¦ç‚¹**ï¼š

> ğŸš€ **æ€§èƒ½æç¤º**ï¼š
> - é¿å…å¤æ‚çš„å¾ªç¯åµŒå¥—
> - åˆç†ä½¿ç”¨å˜é‡ç¼“å­˜è®¡ç®—ç»“æœ  
> - æ¨¡æ¿æ–‡ä»¶ä¸è¦è¿‡å¤§
> - å‡å°‘ä¸å¿…è¦çš„å­—ç¬¦ä¸²æ“ä½œ

```go
# âŒ ä½æ•ˆå†™æ³•
{{ range .Alerts }}
{{ range .Alerts }} # åµŒå¥—å¾ªç¯ï¼Œæ€§èƒ½å·®
{{ end }}
{{ end }}

# âœ… é«˜æ•ˆå†™æ³•  
{{ $alerts := .Alerts }}
{{ $count := len $alerts }}
æ€»è®¡ {{ $count }} ä¸ªå‘Šè­¦
{{ range $alerts }}
{{ .Labels.instance }}
{{ end }}
```

### 7.3 æ¨¡æ¿ç»„ç»‡ç­–ç•¥


**æ–‡ä»¶ç»„ç»‡å»ºè®®**ï¼š
```
templates/
â”œâ”€â”€ common/               # é€šç”¨æ¨¡æ¿
â”‚   â”œâ”€â”€ functions.tmpl   # å…¬å…±å‡½æ•°
â”‚   â”œâ”€â”€ icons.tmpl       # å›¾æ ‡å®šä¹‰
â”‚   â””â”€â”€ layouts.tmpl     # å¸ƒå±€æ¨¡æ¿
â”œâ”€â”€ channels/            # æ¸ é“ä¸“ç”¨
â”‚   â”œâ”€â”€ email.tmpl      
â”‚   â”œâ”€â”€ slack.tmpl
â”‚   â””â”€â”€ wechat.tmpl
â””â”€â”€ apps/                # åº”ç”¨ä¸“ç”¨
    â”œâ”€â”€ kubernetes.tmpl
    â”œâ”€â”€ mysql.tmpl  
    â””â”€â”€ nginx.tmpl
```

**æ¨¡æ¿å¤ç”¨ç¤ºä¾‹**ï¼š
```go
# common/functions.tmpl
{{ define "format.time" }}
{{ .Format "2006-01-02 15:04:05" }}
{{ end }}

# channels/email.tmpl
{{ template "common/functions.tmpl" }}
{{ define "email.subject" }}
å‘Šè­¦æ—¶é—´ï¼š{{ template "format.time" .StartsAt }}
{{ end }}
```

### 7.4 å®‰å…¨æ€§è€ƒè™‘


**å®‰å…¨è¦ç‚¹**ï¼š

> âš ï¸ **å®‰å…¨æé†’**ï¼š
> - é¿å…åœ¨æ¨¡æ¿ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯
> - å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰
> - é™åˆ¶æ¨¡æ¿è®¿é—®æƒé™

```go
# âŒ ä¸å®‰å…¨ï¼šç›´æ¥è¾“å‡ºå¯èƒ½åŒ…å«è„šæœ¬
{{ .Annotations.description }}

# âœ… å®‰å…¨ï¼šHTMLè½¬ä¹‰
{{ .Annotations.description | html }}

# âœ… è¿‡æ»¤æ•æ„Ÿä¿¡æ¯
{{ if ne .Labels.password "" }}
å¯†ç ï¼š*** (å·²éšè—)
{{ end }}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ æ¨¡æ¿ä½œç”¨ï¼šå°†æœºå™¨æ•°æ®è½¬æ¢ä¸ºäººå¯è¯»çš„å‘Šè­¦æ¶ˆæ¯
ğŸ”¸ Goè¯­æ³•ï¼šä½¿ç”¨ {{ }} åŒ…è£¹è¡¨è¾¾å¼ï¼Œæ”¯æŒå˜é‡ã€å‡½æ•°ã€æ§åˆ¶æµ
ğŸ”¸ æ•°æ®ç»“æ„ï¼šStatusã€GroupLabelsã€CommonLabelsã€Alertsç­‰
ğŸ”¸ æ—¶é—´æ ¼å¼ï¼šä½¿ç”¨Goçš„å›ºå®šæ—¶é—´æ ¼å¼ "2006-01-02 15:04:05"
ğŸ”¸ æ¨¡æ¿ç»„ç»‡ï¼šé€šè¿‡defineå®šä¹‰å­æ¨¡æ¿ï¼Œæ”¯æŒç»§æ‰¿å’Œå¤ç”¨
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¨¡æ¿æ•°æ®æµ**ï¼š
```
Prometheuså‘Šè­¦ â†’ Alertmanageræ•°æ®å¯¹è±¡ â†’ æ¨¡æ¿å¤„ç† â†’ æ ¼å¼åŒ–æ¶ˆæ¯
```

**ğŸ”¹ å¸¸ç”¨è¯­æ³•æ¨¡å¼**ï¼š
```go
è®¿é—®æ•°æ®ï¼š{{ .å­—æ®µå }}
æ¡ä»¶åˆ¤æ–­ï¼š{{ if æ¡ä»¶ }} ... {{ end }}
å¾ªç¯éå†ï¼š{{ range .Alerts }} ... {{ end }}
å‡½æ•°è°ƒç”¨ï¼š{{ .Status | toUpper }}
```

**ğŸ”¹ å®ç”¨æŠ€å·§è®°å¿†**ï¼š
- **æ ‡ç­¾ç”¨äºè¯†åˆ«**ï¼šinstanceã€jobã€severityç­‰
- **æ³¨é‡Šç”¨äºæè¿°**ï¼šsummaryã€descriptionã€runbook_urlç­‰  
- **æ—¶é—´éœ€è¦æ ¼å¼åŒ–**ï¼šä½¿ç”¨.Formatæ–¹æ³•
- **URLéœ€è¦æ„å»º**ï¼šç”¨printfæ‹¼æ¥å‚æ•°

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**æ¨¡æ¿çš„æ ¸å¿ƒä»·å€¼**ï¼š
- **æå‡å¯è¯»æ€§**ï¼šæŠŠæŠ€æœ¯æ•°æ®å˜æˆæ˜“æ‡‚çš„æ¶ˆæ¯
- **ç»Ÿä¸€é£æ ¼**ï¼šæ‰€æœ‰å‘Šè­¦ä¿æŒä¸€è‡´çš„æ ¼å¼
- **å¢åŠ ä¿¡æ¯**ï¼šè¡¥å……å¤„ç†å»ºè®®ã€ç›¸å…³é“¾æ¥ç­‰
- **å¤šæ¸ é“é€‚é…**ï¼šåŒä¸€å‘Šè­¦åœ¨ä¸åŒå¹³å°æ˜¾ç¤ºåˆé€‚çš„æ ¼å¼

**å­¦ä¹ è·¯å¾„å»ºè®®**ï¼š
1. **æŒæ¡åŸºç¡€è¯­æ³•**ï¼šå˜é‡è®¿é—®ã€å‡½æ•°ä½¿ç”¨
2. **ç†è§£æ•°æ®ç»“æ„**ï¼šçŸ¥é“ä»å“ªé‡Œè·å–éœ€è¦çš„ä¿¡æ¯
3. **ç»ƒä¹ å¸¸ç”¨åœºæ™¯**ï¼šæ—¶é—´æ ¼å¼åŒ–ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯éå†
4. **å­¦ä¹ é«˜çº§æŠ€å·§**ï¼šæ¨¡æ¿å¤ç”¨ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨è€ƒè™‘

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ¨¡æ¿è®©å‘Šè­¦æ¶ˆæ¯æ›´å‹å¥½ï¼Œç”¨Goè¯­æ³•å¤„ç†æ•°æ®
- æŒæ¡æ•°æ®è®¿é—®è·¯å¾„ï¼Œçµæ´»ä½¿ç”¨æ¡ä»¶å’Œå¾ªç¯
- æ³¨é‡æ¨¡æ¿å¤ç”¨å’Œç»„ç»‡ï¼Œä¿è¯æ€§èƒ½å’Œå®‰å…¨
- å®è·µå‡ºçœŸçŸ¥ï¼Œå¤šå†™å¤šæµ‹è¯•æ‰èƒ½ç†Ÿç»ƒè¿ç”¨