---
title: 3ã€alertmanager.ymlæ ¸å¿ƒé…ç½®
---
## ğŸ“š ç›®å½•

1. [Alertmanageré…ç½®æ–‡ä»¶æ¦‚è¿°](#1-Alertmanageré…ç½®æ–‡ä»¶æ¦‚è¿°)
2. [globalå…¨å±€é…ç½®è¯¦è§£](#2-globalå…¨å±€é…ç½®è¯¦è§£)
3. [routeè·¯ç”±è§„åˆ™æ ¸å¿ƒ](#3-routeè·¯ç”±è§„åˆ™æ ¸å¿ƒ)
4. [receiversæ¥æ”¶å™¨é…ç½®](#4-receiversæ¥æ”¶å™¨é…ç½®)
5. [templatesæ¨¡æ¿ä¸æŠ‘åˆ¶è§„åˆ™](#5-templatesæ¨¡æ¿ä¸æŠ‘åˆ¶è§„åˆ™)
6. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#6-å®æˆ˜é…ç½®æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ Alertmanageré…ç½®æ–‡ä»¶æ¦‚è¿°


### 1.1 é…ç½®æ–‡ä»¶çš„ä½œç”¨


**ğŸ¯ ä»€ä¹ˆæ˜¯alertmanager.yml**

Alertmanagerçš„é…ç½®æ–‡ä»¶å°±åƒæ˜¯ä¸€ä¸ª"æ™ºèƒ½é‚®é€’å‘˜"çš„å·¥ä½œæ‰‹å†Œï¼Œå®ƒå‘Šè¯‰Alertmanagerï¼š
- ğŸ“§ **è°æ¥å‘é€**ï¼šç”¨ä»€ä¹ˆé‚®ç®±ã€ä»€ä¹ˆè´¦å·å‘é€å‘Šè­¦
- ğŸ“® **å‘ç»™è°**ï¼šæ ¹æ®ä¸åŒçš„å‘Šè­¦ç±»å‹ï¼Œå‘ç»™ä¸åŒçš„äºº
- ğŸ• **ä»€ä¹ˆæ—¶å€™å‘**ï¼šå¤šä¹…å‘ä¸€æ¬¡ï¼Œæ€æ ·é¿å…é‡å¤éªšæ‰°
- ğŸ“ **æ€ä¹ˆå‘**ï¼šç”¨ä»€ä¹ˆæ ¼å¼ã€ä»€ä¹ˆå†…å®¹å‘é€

### 1.2 é…ç½®æ–‡ä»¶çš„æ•´ä½“ç»“æ„


```
alertmanager.yml æ–‡ä»¶ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      global             â”‚ â† å…¨å±€é…ç½®ï¼ˆé‚®ä»¶æœåŠ¡å™¨ç­‰ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      route              â”‚ â† è·¯ç”±è§„åˆ™ï¼ˆå‘Šè­¦æ€ä¹ˆåˆ†å‘ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      receivers          â”‚ â† æ¥æ”¶å™¨ï¼ˆå‘Šè­¦å‘ç»™è°ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      templates          â”‚ â† æ¨¡æ¿ï¼ˆå‘Šè­¦å†…å®¹æ ¼å¼ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      inhibit_rules      â”‚ â† æŠ‘åˆ¶è§„åˆ™ï¼ˆé¿å…é‡å¤å‘Šè­¦ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ ç†è§£è¦ç‚¹**

æŠŠAlertmanageræƒ³è±¡æˆä¸€ä¸ªæ™ºèƒ½å¿«é€’åˆ†æ‹£ä¸­å¿ƒï¼š
- **global** = åˆ†æ‹£ä¸­å¿ƒçš„åŸºç¡€è®¾æ–½ï¼ˆä¼ é€å¸¦ã€æ‰«ç æªç­‰ï¼‰
- **route** = åˆ†æ‹£è§„åˆ™ï¼ˆè¿™ä¸ªåŒ…è£¹åº”è¯¥æ”¾åˆ°å“ªä¸ªåŒºåŸŸï¼‰
- **receivers** = é…é€å‘˜ä¿¡æ¯ï¼ˆæ¯ä¸ªåŒºåŸŸç”±è°è´Ÿè´£é…é€ï¼‰
- **templates** = åŒ…è£…æ ‡å‡†ï¼ˆç”¨ä»€ä¹ˆæ ·çš„ç®±å­ã€è´´ä»€ä¹ˆæ ‡ç­¾ï¼‰
- **inhibit_rules** = é˜²é‡å¤è§„åˆ™ï¼ˆåŒæ ·çš„ä¸œè¥¿ä¸è¦é‡å¤å‘ï¼‰

---

## 2. ğŸŒ globalå…¨å±€é…ç½®è¯¦è§£


### 2.1 å…¨å±€é…ç½®çš„å«ä¹‰


**ğŸ”¸ globalé…ç½®æ˜¯ä»€ä¹ˆ**

globalå°±åƒæ˜¯æ•´ä¸ªå…¬å¸çš„"é€šç”¨è®¾ç½®"ï¼Œæ‰€æœ‰éƒ¨é—¨éƒ½è¦éµå®ˆçš„åŸºæœ¬è§„åˆ™ï¼š

```yaml
global:
  # é‚®ä»¶æœåŠ¡å™¨è®¾ç½® - ç›¸å½“äºå…¬å¸çš„é‚®ä»¶ç³»ç»Ÿé…ç½®
  smtp_smarthost: 'smtp.qq.com:587'
  smtp_from: 'monitor@company.com'
  smtp_auth_username: 'monitor@company.com'
  smtp_auth_password: 'your-email-password'
  
  # å…¨å±€è§£æè¶…æ—¶ - æ‰€æœ‰æ“ä½œçš„æœ€é•¿ç­‰å¾…æ—¶é—´
  resolve_timeout: 5m
```

### 2.2 é‚®ä»¶æœåŠ¡å™¨é…ç½®è¯¦è§£


**ğŸ“§ smtp_smarthostï¼šé‚®ä»¶æœåŠ¡å™¨åœ°å€**

```yaml
smtp_smarthost: 'smtp.qq.com:587'
```

**é€šä¿—è§£é‡Š**ï¼š
- å°±åƒä½ è¦å¯„ä¿¡ï¼Œéœ€è¦çŸ¥é“é‚®å±€çš„åœ°å€ä¸€æ ·
- `smtp.qq.com` æ˜¯QQé‚®ç®±çš„é‚®ä»¶æœåŠ¡å™¨åœ°å€
- `587` æ˜¯ç«¯å£å·ï¼Œå°±åƒé‚®å±€çš„å…·ä½“çª—å£å·

**å¸¸ç”¨é‚®ä»¶æœåŠ¡å™¨**ï¼š

| é‚®ä»¶æœåŠ¡å•† | **SMTPæœåŠ¡å™¨åœ°å€** | **ç«¯å£** | **è¯´æ˜** |
|------------|-------------------|----------|----------|
| ğŸ“® **QQé‚®ç®±** | `smtp.qq.com:587` | `587` | `éœ€è¦å¼€å¯SMTPæœåŠ¡` |
| ğŸ“® **163é‚®ç®±** | `smtp.163.com:25` | `25` | `éœ€è¦æˆæƒç ` |
| ğŸ“® **Gmail** | `smtp.gmail.com:587` | `587` | `éœ€è¦åº”ç”¨å¯†ç ` |
| ğŸ“® **ä¼ä¸šé‚®ç®±** | `smtp.company.com:25` | `25` | `è”ç³»ITéƒ¨é—¨è·å–` |

**ğŸ“§ smtp_fromï¼šå‘ä»¶äººåœ°å€**

```yaml
smtp_from: 'monitor@company.com'
```

**é€šä¿—è§£é‡Š**ï¼š
- å°±æ˜¯å‘Šè­¦é‚®ä»¶çš„"å¯„ä»¶äºº"åœ°å€
- æ”¶ä»¶äººçœ‹åˆ°çš„å°±æ˜¯è¿™ä¸ªé‚®ç®±å‘æ¥çš„
- å¿…é¡»æ˜¯çœŸå®å­˜åœ¨çš„é‚®ç®±åœ°å€

**ğŸ“§ é‚®ä»¶è®¤è¯é…ç½®**

```yaml
smtp_auth_username: 'monitor@company.com'  # ç™»å½•é‚®ç®±çš„ç”¨æˆ·å
smtp_auth_password: 'your-email-password'  # ç™»å½•é‚®ç®±çš„å¯†ç 
```

**âš ï¸ é‡è¦æé†’**ï¼š
- å¾ˆå¤šé‚®ç®±éœ€è¦**æˆæƒç **è€Œä¸æ˜¯ç™»å½•å¯†ç 
- QQé‚®ç®±éœ€è¦åœ¨è®¾ç½®ä¸­å¼€å¯SMTPæœåŠ¡å¹¶ç”Ÿæˆæˆæƒç 
- æˆæƒç é€šå¸¸æ˜¯16ä½çš„éšæœºå­—ç¬¦ä¸²

---

## 3. ğŸš¦ routeè·¯ç”±è§„åˆ™æ ¸å¿ƒ


### 3.1 è·¯ç”±è§„åˆ™çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ¯ ä»€ä¹ˆæ˜¯routeè·¯ç”±**

æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªåŒ»é™¢çš„åˆ†è¯ŠæŠ¤å£«ï¼Œç—…äººæ¥äº†ä½ è¦å†³å®šï¼š
- ğŸ”¥ **ç´§æ€¥æƒ…å†µ** â†’ ç›´æ¥é€æ€¥è¯Šç§‘
- ğŸ¤’ **å‘çƒ§æ„Ÿå†’** â†’ é€å†…ç§‘
- ğŸ¦´ **éª¨æŠ˜å¤–ä¼¤** â†’ é€å¤–ç§‘
- ğŸ‘¶ **å°å­©ç”Ÿç—…** â†’ é€å„¿ç§‘

routeè·¯ç”±å°±æ˜¯Alertmanagerçš„"åˆ†è¯Šè§„åˆ™"ï¼Œå†³å®šä¸åŒçš„å‘Šè­¦å‘ç»™ä¸åŒçš„äººã€‚

### 3.2 routeåŸºç¡€é…ç½®


```yaml
route:
  # é»˜è®¤æ¥æ”¶å™¨ - å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å…·ä½“è§„åˆ™ï¼Œå°±å‘ç»™è¿™ä¸ª
  receiver: 'default-receiver'
  
  # åˆ†ç»„å­—æ®µ - æŠŠç›¸ä¼¼çš„å‘Šè­¦å½’ä¸ºä¸€ç»„
  group_by: ['alertname', 'instance']
  
  # åˆ†ç»„ç­‰å¾…æ—¶é—´ - æ”¶åˆ°å‘Šè­¦åç­‰10ç§’ï¼Œçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰ç±»ä¼¼çš„
  group_wait: 10s
  
  # åˆ†ç»„é—´éš” - åŒä¸€ç»„å‘Šè­¦ï¼Œè‡³å°‘é—´éš”10ç§’æ‰èƒ½å†å‘
  group_interval: 10s
  
  # é‡å¤é—´éš” - åŒæ ·çš„å‘Šè­¦ï¼Œ1å°æ—¶åæ‰èƒ½é‡å¤å‘é€
  repeat_interval: 1h
```

### 3.3 åˆ†ç»„æœºåˆ¶è¯¦è§£


**ğŸ“Š group_byåˆ†ç»„å­—æ®µ**

```yaml
group_by: ['alertname', 'instance']
```

**é€šä¿—è§£é‡Š**ï¼š
æŠŠå‘Šè­¦æŒ‰ç…§æŸäº›ç‰¹å¾åˆ†ç»„ï¼Œå°±åƒæ•´ç†æ–‡ä»¶ä¸€æ ·ï¼š

```
åŸå§‹å‘Šè­¦ï¼ˆæ‚ä¹±æ— ç« ï¼‰ï¼š
- æœåŠ¡å™¨A CPUä½¿ç”¨ç‡è¿‡é«˜
- æœåŠ¡å™¨A å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜  
- æœåŠ¡å™¨B CPUä½¿ç”¨ç‡è¿‡é«˜
- æœåŠ¡å™¨A ç£ç›˜ç©ºé—´ä¸è¶³

æŒ‰instanceåˆ†ç»„åï¼ˆäº•äº•æœ‰æ¡ï¼‰ï¼š
â”Œâ”€ æœåŠ¡å™¨Aç»„ â”€â”    â”Œâ”€ æœåŠ¡å™¨Bç»„ â”€â”
â”‚ CPUè¿‡é«˜     â”‚    â”‚ CPUè¿‡é«˜     â”‚
â”‚ å†…å­˜è¿‡é«˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ç£ç›˜ä¸è¶³    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**â° æ—¶é—´é—´éš”é…ç½®å«ä¹‰**

| é…ç½®é¡¹ | **å«ä¹‰** | **æ¯”å–»** | **å»ºè®®å€¼** |
|--------|----------|----------|------------|
| `group_wait` | `æ”¶åˆ°å‘Šè­¦åç­‰å¾…æ—¶é—´` | `ç­‰ç”µæ¢¯çš„æ—¶é—´` | `10s-30s` |
| `group_interval` | `åŒç»„å‘Šè­¦çš„å‘é€é—´éš”` | `åŒä¸€éƒ¨ç”µæ¢¯çš„å‘è½¦é—´éš”` | `5m-10m` |
| `repeat_interval` | `ç›¸åŒå‘Šè­¦çš„é‡å¤é—´éš”` | `é—¹é’Ÿçš„è´ªç¡é—´éš”` | `1h-24h` |

### 3.4 å­è·¯ç”±é…ç½®routes


```yaml
route:
  receiver: 'default-receiver'
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  
  # å­è·¯ç”±é…ç½®
  routes:
  - match:
      severity: critical  # åŒ¹é…ä¸¥é‡å‘Šè­¦
    receiver: 'critical-receiver'
    group_wait: 5s       # ä¸¥é‡å‘Šè­¦ç­‰å¾…æ—¶é—´æ›´çŸ­
    repeat_interval: 30m # ä¸¥é‡å‘Šè­¦é‡å¤é—´éš”æ›´çŸ­
    
  - match_re:
      service: ^(web|api).*  # æ­£åˆ™åŒ¹é…webæˆ–apiå¼€å¤´çš„æœåŠ¡
    receiver: 'web-team'
    continue: true         # ç»§ç»­åŒ¹é…åç»­è§„åˆ™
```

**ğŸ”¸ åŒ¹é…è§„åˆ™ç±»å‹**

| åŒ¹é…ç±»å‹ | **è¯­æ³•** | **è¯´æ˜** | **ç¤ºä¾‹** |
|----------|----------|----------|----------|
| `match` | `ç²¾ç¡®åŒ¹é…` | `æ ‡ç­¾å€¼å®Œå…¨ç›¸ç­‰` | `severity: critical` |
| `match_re` | `æ­£åˆ™åŒ¹é…` | `æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼` | `service: ^web.*` |

**ğŸ”¸ continueç»§ç»­åŒ¹é…**

```yaml
continue: true  # åŒ¹é…åˆ°è¿™ä¸ªè§„åˆ™åï¼Œç»§ç»­æ£€æŸ¥åé¢çš„è§„åˆ™
continue: false # ï¼ˆé»˜è®¤ï¼‰åŒ¹é…åˆ°å°±åœæ­¢ï¼Œä¸å†æ£€æŸ¥åé¢çš„è§„åˆ™
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**

```
å‘Šè­¦åˆ†å‘é€»è¾‘ï¼š

ä¸¥é‡å‘Šè­¦ â†’ ç«‹å³é€šçŸ¥å€¼ç­å·¥ç¨‹å¸ˆ + å‘çŸ­ä¿¡
æ™®é€šå‘Šè­¦ â†’ å‘é‚®ä»¶ç»™ç›¸å…³å›¢é˜Ÿ
æµ‹è¯•ç¯å¢ƒ â†’ åªè®°å½•æ—¥å¿—ï¼Œä¸å‘é€é€šçŸ¥
æ•°æ®åº“é—®é¢˜ â†’ é€šçŸ¥DBAå›¢é˜Ÿ
ç½‘ç»œé—®é¢˜ â†’ é€šçŸ¥è¿ç»´å›¢é˜Ÿ
```

---

## 4. ğŸ“® receiversæ¥æ”¶å™¨é…ç½®


### 4.1 æ¥æ”¶å™¨çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ¯ ä»€ä¹ˆæ˜¯receivers**

receiverså°±åƒæ˜¯ä¸åŒçš„"é€šçŸ¥æ¸ é“"ï¼Œå‘Šè¯‰Alertmanagerç”¨ä»€ä¹ˆæ–¹å¼é€šçŸ¥è°ï¼š

```
é€šçŸ¥æ–¹å¼å¯¹æ¯”ï¼š

ğŸ“§ é‚®ä»¶é€šçŸ¥ â†’ è¯¦ç»†ä¿¡æ¯ï¼Œé€‚åˆæ—¥å¸¸å‘Šè­¦
ğŸ“± çŸ­ä¿¡é€šçŸ¥ â†’ ç®€çŸ­ç´§æ€¥ï¼Œé€‚åˆä¸¥é‡æ•…éšœ  
ğŸ’¬ å¾®ä¿¡é€šçŸ¥ â†’ å³æ—¶å“åº”ï¼Œé€‚åˆå›¢é˜Ÿæ²Ÿé€š
ğŸ“ ç”µè¯é€šçŸ¥ â†’ æœ€é«˜ä¼˜å…ˆçº§ï¼Œé€‚åˆç´§æ€¥æ•…éšœ
```

### 4.2 é‚®ä»¶æ¥æ”¶å™¨é…ç½®


```yaml
receivers:
- name: 'default-receiver'
  email_configs:
  - to: 'admin@company.com'
    subject: 'ğŸš¨ {{ .GroupLabels.alertname }} å‘Šè­¦é€šçŸ¥'
    body: |
      å‘Šè­¦è¯¦æƒ…ï¼š
      {{ range .Alerts }}
      å‘Šè­¦åç§°: {{ .Labels.alertname }}
      å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
      å‘Šè­¦å®ä¾‹: {{ .Labels.instance }}
      å‘Šè­¦æè¿°: {{ .Annotations.description }}
      å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
      {{ end }}
```

**ğŸ“§ é‚®ä»¶é…ç½®å­—æ®µè¯´æ˜**

| å­—æ®µ | **å«ä¹‰** | **ç¤ºä¾‹** |
|------|----------|----------|
| `to` | `æ”¶ä»¶äººé‚®ç®±` | `'admin@company.com'` |
| `subject` | `é‚®ä»¶æ ‡é¢˜` | `'å‘Šè­¦é€šçŸ¥: CPUä½¿ç”¨ç‡è¿‡é«˜'` |
| `body` | `é‚®ä»¶æ­£æ–‡` | `è¯¦ç»†çš„å‘Šè­¦ä¿¡æ¯` |
| `html` | `HTMLæ ¼å¼æ­£æ–‡` | `æ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼` |

### 4.3 å¤šæ¥æ”¶å™¨é…ç½®


```yaml
receivers:
# é»˜è®¤æ¥æ”¶å™¨ - ä¸€èˆ¬å‘Šè­¦
- name: 'default-receiver'
  email_configs:
  - to: 'team@company.com'
    subject: 'ğŸ“Š ç›‘æ§å‘Šè­¦ - {{ .GroupLabels.alertname }}'

# ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨ - å‘ç»™å¤šä¸ªäºº
- name: 'critical-receiver' 
  email_configs:
  - to: 'admin@company.com,manager@company.com'
    subject: 'ğŸš¨ ä¸¥é‡å‘Šè­¦ - {{ .GroupLabels.alertname }}'
  - to: 'oncall@company.com'
    subject: 'ğŸ”¥ ç´§æ€¥é€šçŸ¥ - {{ .GroupLabels.alertname }}'

# Webå›¢é˜Ÿæ¥æ”¶å™¨
- name: 'web-team'
  email_configs:
  - to: 'web-dev@company.com'
    subject: 'ğŸŒ WebæœåŠ¡å‘Šè­¦ - {{ .GroupLabels.alertname }}'
```

**ğŸ’¡ æ¥æ”¶å™¨è®¾è®¡åŸåˆ™**

```
æŒ‰å›¢é˜ŸèŒè´£åˆ†å·¥ï¼š
ğŸ”§ è¿ç»´å›¢é˜Ÿ â†’ åŸºç¡€è®¾æ–½å‘Šè­¦ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
ğŸ’» å¼€å‘å›¢é˜Ÿ â†’ åº”ç”¨æœåŠ¡å‘Šè­¦ï¼ˆAPIã€æ•°æ®åº“ï¼‰  
ğŸŒ å‰ç«¯å›¢é˜Ÿ â†’ å‰ç«¯åº”ç”¨å‘Šè­¦ï¼ˆé¡µé¢ã€CDNï¼‰
ğŸ—„ï¸ DBAå›¢é˜Ÿ â†’ æ•°æ®åº“å‘Šè­¦ï¼ˆè¿æ¥ã€æ€§èƒ½ï¼‰

æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†çº§ï¼š
ğŸŸ¢ ä½çº§å‘Šè­¦ â†’ å‘é‚®ä»¶ï¼Œå·¥ä½œæ—¶é—´å¤„ç†
ğŸŸ¡ ä¸­çº§å‘Šè­¦ â†’ å‘é‚®ä»¶+é’‰é’‰ï¼Œå°½å¿«å¤„ç†
ğŸ”´ é«˜çº§å‘Šè­¦ â†’ å‘é‚®ä»¶+çŸ­ä¿¡ï¼Œç«‹å³å¤„ç†
ğŸš¨ ç´§æ€¥å‘Šè­¦ â†’ å‘é‚®ä»¶+çŸ­ä¿¡+ç”µè¯ï¼Œé©¬ä¸Šå¤„ç†
```

---

## 5. ğŸ“ templatesæ¨¡æ¿ä¸æŠ‘åˆ¶è§„åˆ™


### 5.1 templatesæ¨¡æ¿é…ç½®


**ğŸ¯ ä»€ä¹ˆæ˜¯templates**

templateså°±åƒæ˜¯å‘Šè­¦é‚®ä»¶çš„"æ ¼å¼æ¨¡æ¿"ï¼Œå°±åƒå…¬å¸çš„é‚®ä»¶ç­¾åæ¨¡æ¿ä¸€æ ·ï¼Œè®©æ‰€æœ‰å‘Šè­¦é‚®ä»¶éƒ½æœ‰ç»Ÿä¸€çš„æ ¼å¼å’Œé£æ ¼ã€‚

```yaml
# æŒ‡å®šæ¨¡æ¿æ–‡ä»¶è·¯å¾„
templates:
  - '/etc/alertmanager/templates/*.tmpl'
```

**ğŸ“ æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹**

```go
{{ define "email.subject" }}
ğŸš¨ {{ .GroupLabels.alertname }} | {{ .GroupLabels.severity }} çº§å‘Šè­¦
{{ end }}

{{ define "email.body" }}
ğŸ“Š å‘Šè­¦æ±‡æ€»ï¼šå…± {{ .Alerts | len }} æ¡å‘Šè­¦

{{ range .Alerts }}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ å‘Šè­¦åç§°: {{ .Labels.alertname }}
ğŸ”¥ ä¸¥é‡ç¨‹åº¦: {{ .Labels.severity }}
ğŸ–¥ï¸  å‘Šè­¦å®ä¾‹: {{ .Labels.instance }}  
ğŸ“ å‘Šè­¦æè¿°: {{ .Annotations.description }}
â° å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
{{ end }}

ğŸ’¡ è¯·åŠæ—¶å¤„ç†ç›¸å…³å‘Šè­¦ï¼
{{ end }}
```

### 5.2 inhibit_rulesæŠ‘åˆ¶è§„åˆ™


**ğŸ¯ ä»€ä¹ˆæ˜¯inhibit_rules**

æƒ³è±¡ä½ å®¶é‡ŒåŒæ—¶å‡ºç°äº†è¿™äº›é—®é¢˜ï¼š
- ğŸ”Œ **åœç”µäº†**
- ğŸ“¶ **WiFiæ–­äº†** 
- ğŸ–¥ï¸ **ç”µè„‘å…³æœºäº†**
- ğŸ“± **è·¯ç”±å™¨ä¸å·¥ä½œäº†**

å…¶å®æ ¹æœ¬é—®é¢˜æ˜¯**åœç”µ**ï¼Œå…¶ä»–éƒ½æ˜¯è¿é”ååº”ã€‚inhibit_ruleså°±æ˜¯å‘Šè¯‰Alertmanagerï¼š"å¦‚æœæ˜¯åœç”µå‘Šè­¦ï¼Œå°±ä¸è¦å†å‘WiFiæ–­çº¿ã€ç”µè„‘å…³æœºçš„å‘Šè­¦äº†"ã€‚

```yaml
inhibit_rules:
# å¦‚æœæœ‰ä¸¥é‡å‘Šè­¦ï¼Œå°±æŠ‘åˆ¶ä¸€èˆ¬å‘Šè­¦
- source_match:
    severity: 'critical'     # æºå‘Šè­¦ï¼šä¸¥é‡çº§åˆ«
  target_match:
    severity: 'warning'      # ç›®æ ‡å‘Šè­¦ï¼šè­¦å‘Šçº§åˆ«
  equal: ['instance']        # ç›¸åŒå®ä¾‹çš„å‘Šè­¦æ‰æŠ‘åˆ¶

# å¦‚æœæœåŠ¡å™¨å®•æœºï¼Œå°±æŠ‘åˆ¶è¯¥æœåŠ¡å™¨çš„å…¶ä»–å‘Šè­¦  
- source_match:
    alertname: 'InstanceDown'  # æºå‘Šè­¦ï¼šå®ä¾‹å®•æœº
  target_match_re:
    alertname: '.*'            # ç›®æ ‡å‘Šè­¦ï¼šä»»ä½•å‘Šè­¦
  equal: ['instance']          # ç›¸åŒå®ä¾‹
```

**ğŸ”¸ æŠ‘åˆ¶è§„åˆ™å­—æ®µè¯´æ˜**

| å­—æ®µ | **å«ä¹‰** | **ç¤ºä¾‹** |
|------|----------|----------|
| `source_match` | `æºå‘Šè­¦åŒ¹é…æ¡ä»¶` | `severity: critical` |
| `target_match` | `ç›®æ ‡å‘Šè­¦åŒ¹é…æ¡ä»¶` | `severity: warning` |
| `equal` | `ç›¸åŒå­—æ®µæ‰æŠ‘åˆ¶` | `['instance', 'job']` |

**ğŸ’¡ å¸¸è§æŠ‘åˆ¶è§„åˆ™åœºæ™¯**

```
å®é™…åº”ç”¨åœºæ™¯ï¼š

æœåŠ¡å™¨å®•æœº â†’ æŠ‘åˆ¶è¯¥æœåŠ¡å™¨çš„æ‰€æœ‰æœåŠ¡å‘Šè­¦
ç½‘ç»œæ–­å¼€ â†’ æŠ‘åˆ¶ç½‘ç»œç›¸å…³çš„è¿æ¥å‘Šè­¦  
æ•°æ®åº“å®•æœº â†’ æŠ‘åˆ¶åº”ç”¨è¿æ¥æ•°æ®åº“çš„å‘Šè­¦
ç£ç›˜æ»¡äº† â†’ æŠ‘åˆ¶ç£ç›˜å†™å…¥å¤±è´¥çš„å‘Šè­¦
```

---

## 6. ğŸš€ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 6.1 å®Œæ•´é…ç½®ç¤ºä¾‹


```yaml
# å…¨å±€é…ç½®
global:
  smtp_smarthost: 'smtp.qq.com:587'
  smtp_from: 'monitor@company.com'
  smtp_auth_username: 'monitor@company.com'
  smtp_auth_password: 'your-auth-code'
  resolve_timeout: 5m

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# è·¯ç”±é…ç½®
route:
  receiver: 'default'
  group_by: ['alertname', 'instance']
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 1h
  
  routes:
  # ä¸¥é‡å‘Šè­¦è·¯ç”±
  - match:
      severity: critical
    receiver: 'critical-team'
    group_wait: 5s
    repeat_interval: 30m
    
  # WebæœåŠ¡å‘Šè­¦è·¯ç”±  
  - match_re:
      service: ^(web|api|frontend).*
    receiver: 'web-team'
    
  # æ•°æ®åº“å‘Šè­¦è·¯ç”±
  - match:
      job: mysql
    receiver: 'dba-team'

# æ¥æ”¶å™¨é…ç½®
receivers:
- name: 'default'
  email_configs:
  - to: 'admin@company.com'
    subject: 'ğŸ“Š {{ .GroupLabels.alertname }} ç›‘æ§å‘Šè­¦'
    
- name: 'critical-team'
  email_configs:
  - to: 'admin@company.com,manager@company.com'
    subject: 'ğŸš¨ ä¸¥é‡å‘Šè­¦ - {{ .GroupLabels.alertname }}'
  - to: 'oncall@company.com'
    subject: 'ğŸ”¥ ç´§æ€¥é€šçŸ¥ - ç«‹å³å¤„ç†'
    
- name: 'web-team' 
  email_configs:
  - to: 'web-dev@company.com'
    subject: 'ğŸŒ WebæœåŠ¡å‘Šè­¦ - {{ .GroupLabels.alertname }}'
    
- name: 'dba-team'
  email_configs:
  - to: 'dba@company.com'
    subject: 'ğŸ—„ï¸ æ•°æ®åº“å‘Šè­¦ - {{ .GroupLabels.alertname }}'

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
- source_match:
    severity: 'critical'
  target_match:
    severity: 'warning'  
  equal: ['instance']
  
- source_match:
    alertname: 'InstanceDown'
  target_match_re:
    alertname: '.*'
  equal: ['instance']
```

### 6.2 é…ç½®æ–‡ä»¶éªŒè¯


**ğŸ”§ æ£€æŸ¥é…ç½®è¯­æ³•**

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®
amtool config check alertmanager.yml

# æ˜¾ç¤ºå½“å‰é…ç½®
amtool config show --alertmanager.url=http://localhost:9093
```

**ğŸ“‹ å¸¸è§é…ç½®é”™è¯¯**

| é”™è¯¯ç±»å‹ | **é—®é¢˜æè¿°** | **è§£å†³æ–¹æ³•** |
|----------|-------------|-------------|
| `è¯­æ³•é”™è¯¯` | `YAMLæ ¼å¼ä¸æ­£ç¡®` | `æ£€æŸ¥ç¼©è¿›å’Œå¼•å·` |
| `é‚®ä»¶å‘é€å¤±è´¥` | `é‚®ç®±å¯†ç é”™è¯¯` | `ä½¿ç”¨æˆæƒç è€Œä¸æ˜¯ç™»å½•å¯†ç ` |
| `è·¯ç”±ä¸åŒ¹é…` | `å‘Šè­¦å‘åˆ°é»˜è®¤æ¥æ”¶å™¨` | `æ£€æŸ¥matchæ¡ä»¶æ˜¯å¦æ­£ç¡®` |
| `é‡å¤å‘Šè­¦` | `çŸ­æ—¶é—´æ”¶åˆ°å¤šæ¡ç›¸åŒå‘Šè­¦` | `è°ƒæ•´group_intervalå’Œrepeat_interval` |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ globalï¼šå…¨å±€åŸºç¡€è®¾ç½®ï¼Œä¸»è¦æ˜¯é‚®ä»¶æœåŠ¡å™¨é…ç½®
ğŸ”¸ routeï¼šå‘Šè­¦è·¯ç”±åˆ†å‘ï¼Œå†³å®šå‘Šè­¦å‘ç»™è°
ğŸ”¸ receiversï¼šæ¥æ”¶å™¨å®šä¹‰ï¼Œå…·ä½“çš„é€šçŸ¥æ–¹å¼å’Œäººå‘˜
ğŸ”¸ templatesï¼šå‘Šè­¦æ¨¡æ¿ï¼Œç»Ÿä¸€å‘Šè­¦é‚®ä»¶æ ¼å¼
ğŸ”¸ inhibit_rulesï¼šæŠ‘åˆ¶è§„åˆ™ï¼Œé¿å…é‡å¤å‘Šè­¦éªšæ‰°
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é…ç½®æ–‡ä»¶çš„é€»è¾‘å…³ç³»**

```
å‘Šè­¦å¤„ç†æµç¨‹ï¼š

Prometheuså‘é€å‘Šè­¦ 
       â†“
Alertmanageræ¥æ”¶å‘Šè­¦
       â†“  
routeè·¯ç”±è§„åˆ™åŒ¹é… â†’ å†³å®šå‘ç»™å“ªä¸ªreceiver
       â†“
receiversæ¥æ”¶å™¨å¤„ç† â†’ æŒ‰æ¨¡æ¿æ ¼å¼å‘é€é€šçŸ¥
       â†“
inhibit_rulesæ£€æŸ¥ â†’ é¿å…é‡å¤å‘é€
```

**ğŸ”¹ æ—¶é—´é—´éš”çš„å®é™…æ„ä¹‰**

```
group_wait: 10s
å«ä¹‰ï¼šæ”¶åˆ°å‘Šè­¦åç­‰10ç§’ï¼Œçœ‹çœ‹æ˜¯å¦è¿˜æœ‰ç±»ä¼¼å‘Šè­¦ä¸€èµ·å‘é€
å¥½å¤„ï¼šé¿å…çŸ­æ—¶é—´å†…æ”¶åˆ°å¾ˆå¤šæ¡åˆ†æ•£çš„å‘Šè­¦é‚®ä»¶

group_interval: 5m  
å«ä¹‰ï¼šåŒä¸€ç»„å‘Šè­¦ï¼Œ5åˆ†é’Ÿå†…æœ€å¤šå‘é€ä¸€æ¬¡
å¥½å¤„ï¼šé¿å…ç›¸åŒé—®é¢˜åå¤å‘é€å‘Šè­¦

repeat_interval: 1h
å«ä¹‰ï¼šç›¸åŒçš„å‘Šè­¦ï¼Œ1å°æ—¶åæ‰èƒ½é‡å¤å‘é€
å¥½å¤„ï¼šæŒç»­çš„é—®é¢˜ä¸ä¼šæ¯åˆ†é’Ÿéƒ½å‘é‚®ä»¶éªšæ‰°
```

**ğŸ”¹ é‚®ä»¶é…ç½®çš„å…³é”®ç‚¹**

```
å¸¸è§é‚®ç®±é…ç½®è¦ç‚¹ï¼š

QQé‚®ç®±ï¼š
- éœ€è¦å¼€å¯SMTPæœåŠ¡
- ä½¿ç”¨æˆæƒç ï¼Œä¸æ˜¯QQå¯†ç 
- ç«¯å£é€šå¸¸æ˜¯587

ä¼ä¸šé‚®ç®±ï¼š
- è”ç³»ITéƒ¨é—¨è·å–SMTPæœåŠ¡å™¨åœ°å€
- å¯èƒ½éœ€è¦VPNæˆ–å†…ç½‘è®¿é—®
- æ³¨æ„ç«¯å£å’ŒåŠ å¯†æ–¹å¼
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š å‘Šè­¦åˆ†çº§å»ºè®®**

| å‘Šè­¦çº§åˆ« | **å“åº”æ—¶é—´** | **é€šçŸ¥æ–¹å¼** | **å…¸å‹åœºæ™¯** |
|----------|-------------|-------------|-------------|
| ğŸŸ¢ `info` | `ä¸éœ€è¦ç«‹å³å“åº”` | `é‚®ä»¶` | `å¤‡ä»½å®Œæˆã€ç‰ˆæœ¬éƒ¨ç½²` |
| ğŸŸ¡ `warning` | `å·¥ä½œæ—¶é—´å¤„ç†` | `é‚®ä»¶` | `CPUä½¿ç”¨ç‡80%` |
| ğŸŸ  `major` | `å°½å¿«å¤„ç†` | `é‚®ä»¶+é’‰é’‰` | `ç£ç›˜ä½¿ç”¨ç‡90%` |
| ğŸ”´ `critical` | `ç«‹å³å¤„ç†` | `é‚®ä»¶+çŸ­ä¿¡` | `æœåŠ¡å®•æœºã€æ•°æ®åº“è¿æ¥å¤±è´¥` |

**ğŸ¯ é…ç½®ä¼˜åŒ–å»ºè®®**

```
æ–°æ‰‹é…ç½®å»ºè®®ï¼š

1. å…ˆé…ç½®åŸºæœ¬çš„é‚®ä»¶é€šçŸ¥
2. è®¾ç½®åˆç†çš„æ—¶é—´é—´éš”ï¼ˆé¿å…å‘Šè­¦è½°ç‚¸ï¼‰
3. æŒ‰å›¢é˜ŸèŒè´£é…ç½®ä¸åŒçš„æ¥æ”¶å™¨
4. é€æ­¥å®Œå–„æŠ‘åˆ¶è§„åˆ™
5. å®šæœŸæ£€æŸ¥å’Œä¼˜åŒ–é…ç½®

æ—¶é—´é—´éš”å‚è€ƒå€¼ï¼š
group_wait: 10s-30s
group_interval: 5m-10m  
repeat_interval: 1h-6h
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ğŸ“§ globalé…ç½®é‚®ä»¶æœåŠ¡å™¨ï¼Œæ˜¯å‘é€åŸºç¡€
- ğŸš¦ routeå†³å®šå‘Šè­¦å»å‘ï¼Œæ˜¯åˆ†å‘æ ¸å¿ƒ
- ğŸ“® receiverså®šä¹‰é€šçŸ¥æ–¹å¼ï¼Œæ˜¯æ‰§è¡Œæœ«ç«¯
- â° æ—¶é—´é—´éš”æ§åˆ¶å‘é€é¢‘ç‡ï¼Œé¿å…éªšæ‰°
- ğŸš« æŠ‘åˆ¶è§„åˆ™å‡å°‘é‡å¤ï¼Œæé«˜æ•ˆç‡