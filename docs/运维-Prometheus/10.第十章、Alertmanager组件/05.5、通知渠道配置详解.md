---
title: 5ã€é€šçŸ¥æ¸ é“é…ç½®è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [é€šçŸ¥æ¸ é“åŸºç¡€æ¦‚å¿µ](#1-é€šçŸ¥æ¸ é“åŸºç¡€æ¦‚å¿µ)
2. [é‚®ä»¶é€šçŸ¥é…ç½®](#2-é‚®ä»¶é€šçŸ¥é…ç½®)
3. [Webhooké€šçŸ¥é…ç½®](#3-Webhooké€šçŸ¥é…ç½®)
4. [Slacké€šçŸ¥é…ç½®](#4-Slacké€šçŸ¥é…ç½®)
5. [å¾®ä¿¡é€šçŸ¥é…ç½®](#5-å¾®ä¿¡é€šçŸ¥é…ç½®)
6. [PagerDutyé€šçŸ¥é…ç½®](#6-PagerDutyé€šçŸ¥é…ç½®)
7. [é€šçŸ¥è®¤è¯ä¸å®‰å…¨](#7-é€šçŸ¥è®¤è¯ä¸å®‰å…¨)
8. [é€šçŸ¥é‡è¯•ä¸è¶…æ—¶æœºåˆ¶](#8-é€šçŸ¥é‡è¯•ä¸è¶…æ—¶æœºåˆ¶)
9. [å¤šæ¸ é“ç»„åˆç­–ç•¥](#9-å¤šæ¸ é“ç»„åˆç­–ç•¥)
10. [é€šçŸ¥æµ‹è¯•ä¸æ•…éšœæ’é™¤](#10-é€šçŸ¥æµ‹è¯•ä¸æ•…éšœæ’é™¤)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¢ é€šçŸ¥æ¸ é“åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é€šçŸ¥æ¸ é“

ğŸ¯ **ç®€å•ç†è§£**ï¼šé€šçŸ¥æ¸ é“å°±åƒå®¶é‡Œçš„é—¨é“ƒï¼Œå½“æœ‰è®¿å®¢æ—¶ä¼šç”¨ä¸åŒæ–¹å¼æé†’ä½ 

```
ç”Ÿæ´»ä¸­çš„é€šçŸ¥æ–¹å¼ï¼š
é—¨é“ƒå“å£° â†’ æœ‰äººæŒ‰é—¨é“ƒ
æ‰‹æœºæŒ¯åŠ¨ â†’ æœ‰çŸ­ä¿¡æˆ–ç”µè¯
é‚®ç®±æç¤º â†’ æ”¶åˆ°æ–°é‚®ä»¶

Alertmanagerçš„é€šçŸ¥æ¸ é“ï¼š
é‚®ä»¶é€šçŸ¥ â†’ å‘é€å‘Šè­¦é‚®ä»¶
Slackæ¶ˆæ¯ â†’ å›¢é˜Ÿåä½œå·¥å…·æé†’
Webhook â†’ è‡ªå®šä¹‰ç³»ç»Ÿé›†æˆ
å¾®ä¿¡é€šçŸ¥ â†’ ä¼ä¸šå¾®ä¿¡ç¾¤æ¶ˆæ¯
```

**ğŸ”¸ é€šçŸ¥æ¸ é“çš„æ ¸å¿ƒä½œç”¨**
```
åŠæ—¶å‘ŠçŸ¥ï¼šç¬¬ä¸€æ—¶é—´é€šçŸ¥ç›¸å…³äººå‘˜
å¤šæ ·é€‰æ‹©ï¼šä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒæ¸ é“
å¯é ä¼ é€’ï¼šç¡®ä¿é‡è¦å‘Šè­¦ä¸é—æ¼
çµæ´»é…ç½®ï¼šæ ¹æ®å‘Šè­¦çº§åˆ«é€‰æ‹©æ¸ é“
```

### 1.2 Alertmanageré€šçŸ¥æµç¨‹

**ğŸ“‹ å‘Šè­¦é€šçŸ¥çš„å®Œæ•´æµç¨‹**

```
å‘Šè­¦äº§ç”Ÿæµç¨‹å›¾ï¼š
Prometheusé‡‡é›†æ•°æ® â†’ è¯„ä¼°å‘Šè­¦è§„åˆ™ â†’ å‘é€åˆ°Alertmanager
                                           â†“
    é€šçŸ¥å‘é€æˆåŠŸ â† é€‰æ‹©é€šçŸ¥æ¸ é“ â† è·¯ç”±åŒ¹é… â† å‘Šè­¦åˆ†ç»„å»é‡
         â†“
    è®°å½•é€šçŸ¥æ—¥å¿—
```

**ğŸ’¡ æµç¨‹è¯¦ç»†è¯´æ˜**
```
æ­¥éª¤1ï¼šå‘Šè­¦æ¥æ”¶
Alertmanageræ¥æ”¶Prometheuså‘é€çš„å‘Šè­¦

æ­¥éª¤2ï¼šè·¯ç”±åŒ¹é…  
æ ¹æ®å‘Šè­¦æ ‡ç­¾åŒ¹é…ç›¸åº”çš„è·¯ç”±è§„åˆ™

æ­¥éª¤3ï¼šåˆ†ç»„å»é‡
å°†ç›¸ä¼¼å‘Šè­¦åˆ†ç»„ï¼Œé¿å…é‡å¤é€šçŸ¥

æ­¥éª¤4ï¼šæ¸ é“é€‰æ‹©
æ ¹æ®é…ç½®é€‰æ‹©åˆé€‚çš„é€šçŸ¥æ¸ é“

æ­¥éª¤5ï¼šå‘é€é€šçŸ¥
å®é™…æ‰§è¡Œé€šçŸ¥å‘é€æ“ä½œ

æ­¥éª¤6ï¼šè®°å½•æ—¥å¿—
è®°å½•é€šçŸ¥å‘é€çŠ¶æ€å’Œç»“æœ
```

### 1.3 é€šçŸ¥æ¸ é“é…ç½®ç»“æ„

**ğŸ—ï¸ Alertmanageré…ç½®æ–‡ä»¶ç»“æ„**

```yaml
# alertmanager.yml åŸºæœ¬ç»“æ„
global:
  # å…¨å±€é…ç½®
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alerts@company.com'

route:
  # è·¯ç”±é…ç½®
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'

receivers:
  # æ¥æ”¶å™¨é…ç½®ï¼ˆåŒ…å«å„ç§é€šçŸ¥æ¸ é“ï¼‰
  - name: 'default-receiver'
    email_configs: []
    slack_configs: []
    webhook_configs: []
```

---

## 2. ğŸ“§ é‚®ä»¶é€šçŸ¥é…ç½®


### 2.1 é‚®ä»¶é€šçŸ¥åŸºç¡€é…ç½®

**ğŸ“® æœ€å¸¸ç”¨çš„é€šçŸ¥æ–¹å¼ - é‚®ä»¶**

é‚®ä»¶é€šçŸ¥å°±åƒä¼ ç»Ÿçš„ä¿¡ä»¶ï¼Œè™½ç„¶ä¸æ˜¯æœ€å¿«çš„ï¼Œä½†æ˜¯æœ€å¯é å’Œæ­£å¼çš„é€šçŸ¥æ–¹å¼ã€‚æ¯ä¸ªäººéƒ½æœ‰é‚®ç®±ï¼Œæ”¶åˆ°é‚®ä»¶åå¯ä»¥ä¿å­˜å’Œè½¬å‘ã€‚

**ğŸ”§ åŸºç¡€é‚®ä»¶é…ç½®**
```yaml
global:
  # SMTPæœåŠ¡å™¨é…ç½®
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'monitoring@company.com'
  smtp_auth_username: 'monitoring@company.com'
  smtp_auth_password: 'your_app_password'

receivers:
  - name: 'email-notifications'
    email_configs:
      - to: 'admin@company.com'
        subject: 'ğŸš¨ å‘Šè­¦é€šçŸ¥ï¼š{{ .GroupLabels.alertname }}'
        body: |
          å‘Šè­¦è¯¦æƒ…ï¼š
          å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}
          å‘Šè­¦çº§åˆ«ï¼š{{ .CommonLabels.severity }}
          å‘Šè­¦æ—¶é—´ï¼š{{ .CommonAnnotations.timestamp }}
          
          å…·ä½“ä¿¡æ¯ï¼š
          {{ range .Alerts }}
          - å®ä¾‹ï¼š{{ .Labels.instance }}
          - æè¿°ï¼š{{ .Annotations.description }}
          {{ end }}
```

### 2.2 ä¼ä¸šé‚®ä»¶æœåŠ¡é…ç½®

**ğŸ¢ ä¸åŒé‚®ä»¶æœåŠ¡å•†çš„é…ç½®æ–¹æ³•**

**Gmailé…ç½®ç¤ºä¾‹**
```yaml
global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'your-email@gmail.com'
  smtp_auth_username: 'your-email@gmail.com'
  smtp_auth_password: 'your_app_password'  # åº”ç”¨ä¸“ç”¨å¯†ç 
  smtp_require_tls: true
```

**ä¼ä¸šExchangeæœåŠ¡å™¨é…ç½®**
```yaml
global:
  smtp_smarthost: 'mail.company.com:25'
  smtp_from: 'monitoring@company.com'
  smtp_auth_username: 'DOMAIN\\monitoring'
  smtp_auth_password: 'password'
  smtp_require_tls: false
```

**è…¾è®¯ä¼ä¸šé‚®ç®±é…ç½®**
```yaml
global:
  smtp_smarthost: 'smtp.exmail.qq.com:465'
  smtp_from: 'monitoring@company.com'
  smtp_auth_username: 'monitoring@company.com'
  smtp_auth_password: 'your_password'
  smtp_require_tls: true
```

### 2.3 é‚®ä»¶æ¨¡æ¿å®šåˆ¶

**âœ¨ è®©é‚®ä»¶é€šçŸ¥æ›´ç¾è§‚å’Œå®ç”¨**

**HTMLæ ¼å¼é‚®ä»¶æ¨¡æ¿**
```yaml
receivers:
  - name: 'html-email'
    email_configs:
      - to: 'team@company.com'
        subject: 'ã€{{ .Status | toUpper }}ã€‘{{ .GroupLabels.alertname }}'
        html: |
          <html>
          <head>
            <style>
              .alert-firing { background-color: #ffebee; border-left: 4px solid #f44336; }
              .alert-resolved { background-color: #e8f5e8; border-left: 4px solid #4caf50; }
              .alert-info { padding: 15px; margin: 10px 0; }
            </style>
          </head>
          <body>
            <h2>å‘Šè­¦é€šçŸ¥</h2>
            <div class="alert-{{ .Status }}">
              <h3>{{ .GroupLabels.alertname }}</h3>
              <p><strong>çŠ¶æ€ï¼š</strong>{{ .Status | toUpper }}</p>
              <p><strong>çº§åˆ«ï¼š</strong>{{ .CommonLabels.severity }}</p>
              <p><strong>æ—¶é—´ï¼š</strong>{{ .CommonAnnotations.timestamp }}</p>
              
              <h4>å½±å“å®ä¾‹ï¼š</h4>
              <ul>
              {{ range .Alerts }}
                <li>{{ .Labels.instance }} - {{ .Annotations.description }}</li>
              {{ end }}
              </ul>
            </div>
          </body>
          </html>
```

**ğŸ“± ç§»åŠ¨ç«¯å‹å¥½çš„é‚®ä»¶æ ¼å¼**
```yaml
receivers:
  - name: 'mobile-friendly-email'
    email_configs:
      - to: 'oncall@company.com'
        subject: 'ğŸš¨{{ .GroupLabels.alertname }}({{ .Alerts | len }}ä¸ª)'
        body: |
          âš ï¸ å‘Šè­¦æ¦‚è¦ âš ï¸
          
          ğŸ“ åç§°ï¼š{{ .GroupLabels.alertname }}
          ğŸ”¥ çº§åˆ«ï¼š{{ .CommonLabels.severity }}
          â° æ—¶é—´ï¼š{{ .CommonAnnotations.timestamp }}
          ğŸ“Š æ•°é‡ï¼š{{ .Alerts | len }} ä¸ªå®ä¾‹
          
          ğŸ“‹ è¯¦ç»†ä¿¡æ¯ï¼š
          {{ range .Alerts }}
          ğŸ–¥ï¸ {{ .Labels.instance }}
          ğŸ’¬ {{ .Annotations.description }}
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          {{ end }}
          
          ğŸ”— è®¿é—®Grafana: http://grafana.company.com
```

---

## 3. ğŸ”— Webhooké€šçŸ¥é…ç½®


### 3.1 Webhooké€šçŸ¥åŸç†

**ğŸ¯ ä»€ä¹ˆæ˜¯Webhook**

Webhookå°±åƒé¤å…çš„å¤–å–é…é€ï¼Œå½“æœ‰å‘Šè­¦æ—¶ï¼ŒAlertmanagerä¼šä¸»åŠ¨"é…é€"å‘Šè­¦ä¿¡æ¯åˆ°æŒ‡å®šçš„ç½‘å€ï¼Œè€Œä¸éœ€è¦ä½ ä¸»åŠ¨å»æŸ¥è¯¢ã€‚

**ğŸ’¡ Webhookçš„å·¥ä½œæ–¹å¼**
```
ä¼ ç»Ÿæ–¹å¼ï¼ˆè½®è¯¢ï¼‰ï¼š
ä½ çš„ç³»ç»Ÿæ¯éš”ä¸€æ®µæ—¶é—´é—®ï¼š"æœ‰æ–°å‘Šè­¦å—ï¼Ÿ"
è¿™æ ·å¾ˆæµªè´¹èµ„æºï¼Œä¹Ÿä¸å¤ŸåŠæ—¶

Webhookæ–¹å¼ï¼ˆæ¨é€ï¼‰ï¼š
Alertmanagerä¸»åŠ¨è¯´ï¼š"æœ‰æ–°å‘Šè­¦äº†ï¼"
ç›´æ¥å‘é€åˆ°ä½ æŒ‡å®šçš„ç½‘å€ï¼Œå®æ—¶é«˜æ•ˆ
```

### 3.2 åŸºç¡€Webhooké…ç½®

**ğŸ”§ æœ€ç®€å•çš„Webhookè®¾ç½®**

```yaml
receivers:
  - name: 'webhook-receiver'
    webhook_configs:
      - url: 'http://your-api.com/alerts'
        http_config:
          basic_auth:
            username: 'webhook_user'
            password: 'webhook_pass'
        send_resolved: true
```

**ğŸ“‹ Webhookå‘é€çš„æ•°æ®æ ¼å¼**
å½“Alertmanagerå‘é€Webhookæ—¶ï¼Œä¼šåŒ…å«è¿™äº›ä¿¡æ¯ï¼š
```json
{
  "receiver": "webhook-receiver",
  "status": "firing",
  "alerts": [
    {
      "status": "firing",
      "labels": {
        "alertname": "HighCPUUsage",
        "instance": "server01:9100",
        "severity": "warning"
      },
      "annotations": {
        "description": "CPUä½¿ç”¨ç‡è¶…è¿‡80%",
        "summary": "æœåŠ¡å™¨CPUè´Ÿè½½è¿‡é«˜"
      },
      "startsAt": "2024-01-15T10:30:00Z",
      "endsAt": "0001-01-01T00:00:00Z"
    }
  ],
  "groupLabels": {
    "alertname": "HighCPUUsage"
  },
  "commonLabels": {
    "alertname": "HighCPUUsage",
    "severity": "warning"
  },
  "commonAnnotations": {
    "description": "CPUä½¿ç”¨ç‡è¶…è¿‡80%"
  }
}
```

### 3.3 è‡ªå®šä¹‰Webhookå¤„ç†

**ğŸ› ï¸ æ¥æ”¶å’Œå¤„ç†Webhookçš„ç¤ºä¾‹ä»£ç **

**Python Flaskç¤ºä¾‹**
```python
from flask import Flask, request, jsonify
import json
import requests

app = Flask(__name__)

@app.route('/alerts', methods=['POST'])
def handle_alert():
    # æ¥æ”¶Alertmanagerå‘é€çš„å‘Šè­¦
    alert_data = request.get_json()
    
    # è§£æå‘Šè­¦ä¿¡æ¯
    status = alert_data.get('status')
    alerts = alert_data.get('alerts', [])
    
    for alert in alerts:
        alert_name = alert['labels'].get('alertname')
        instance = alert['labels'].get('instance')
        severity = alert['labels'].get('severity')
        description = alert['annotations'].get('description')
        
        # æ ¹æ®å‘Šè­¦çº§åˆ«é‡‡å–ä¸åŒè¡ŒåŠ¨
        if severity == 'critical':
            send_sms_alert(alert_name, instance, description)
        elif severity == 'warning':
            send_chat_message(alert_name, instance, description)
    
    return jsonify({'status': 'received'}), 200

def send_sms_alert(alert_name, instance, description):
    """å‘é€çŸ­ä¿¡å‘Šè­¦ï¼ˆç¤ºä¾‹ï¼‰"""
    print(f"å‘é€çŸ­ä¿¡ï¼š{alert_name} - {instance}: {description}")

def send_chat_message(alert_name, instance, description):
    """å‘é€èŠå¤©æ¶ˆæ¯ï¼ˆç¤ºä¾‹ï¼‰"""
    print(f"å‘é€æ¶ˆæ¯ï¼š{alert_name} - {instance}: {description}")

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

### 3.4 é«˜çº§Webhooké…ç½®

**âš¡ æ›´å¤æ‚çš„Webhookåº”ç”¨åœºæ™¯**

**å¤šURLè½¬å‘é…ç½®**
```yaml
receivers:
  - name: 'multi-webhook'
    webhook_configs:
      # å‘é€åˆ°ä¸»å¤„ç†ç³»ç»Ÿ
      - url: 'http://primary-handler.com/alerts'
        max_alerts: 0  # å‘é€æ‰€æœ‰å‘Šè­¦
        
      # å‘é€åˆ°å¤‡ä»½ç³»ç»Ÿ
      - url: 'http://backup-handler.com/alerts'
        max_alerts: 10  # æœ€å¤šå‘é€10ä¸ªå‘Šè­¦
        
      # å‘é€åˆ°æ—¥å¿—ç³»ç»Ÿ
      - url: 'http://log-system.com/webhook'
        http_config:
          bearer_token: 'your_token_here'
        send_resolved: false  # åªå‘é€è§¦å‘çš„å‘Šè­¦
```

**å¸¦é‡è¯•æœºåˆ¶çš„Webhook**
```yaml
receivers:
  - name: 'reliable-webhook'
    webhook_configs:
      - url: 'http://api.company.com/alerts'
        http_config:
          proxy_url: 'http://proxy:8080'
          tls_config:
            insecure_skip_verify: false
        send_resolved: true
        max_alerts: 5
```

---

## 4. ğŸ’¬ Slacké€šçŸ¥é…ç½®


### 4.1 Slacké€šçŸ¥åŸºç¡€

**ğŸ“± å›¢é˜Ÿåä½œå·¥å…·ä¸­çš„å‘Šè­¦é€šçŸ¥**

Slackå°±åƒå…¬å¸çš„èŠå¤©ç¾¤ï¼Œå½“æœ‰å‘Šè­¦æ—¶ï¼ŒAlertmanagerä¼šåœ¨ç¾¤é‡Œå‘æ¶ˆæ¯é€šçŸ¥å¤§å®¶ã€‚è¿™æ ·å›¢é˜Ÿæˆå‘˜éƒ½èƒ½ç¬¬ä¸€æ—¶é—´çœ‹åˆ°ï¼Œè¿˜èƒ½ç›´æ¥åœ¨ç¾¤é‡Œè®¨è®ºè§£å†³æ–¹æ¡ˆã€‚

### 4.2 Slacké›†æˆå‡†å¤‡

**ğŸ”§ é…ç½®Slackæ¥æ”¶å‘Šè­¦çš„å‡†å¤‡å·¥ä½œ**

**æ­¥éª¤1ï¼šåˆ›å»ºSlackåº”ç”¨**
1. è®¿é—® https://api.slack.com/apps
2. ç‚¹å‡»"Create New App"
3. é€‰æ‹©"From scratch"
4. è¾“å…¥åº”ç”¨åç§°ï¼Œé€‰æ‹©å·¥ä½œç©ºé—´

**æ­¥éª¤2ï¼šé…ç½®Incoming Webhooks**
1. åœ¨åº”ç”¨è®¾ç½®ä¸­æ‰¾åˆ°"Incoming Webhooks"
2. æ¿€æ´»Incoming WebhooksåŠŸèƒ½
3. ç‚¹å‡»"Add New Webhook to Workspace"
4. é€‰æ‹©è¦å‘é€æ¶ˆæ¯çš„é¢‘é“
5. å¤åˆ¶ç”Ÿæˆçš„Webhook URL

### 4.3 Slacké€šçŸ¥é…ç½®

**ğŸ’¬ åœ¨Alertmanagerä¸­é…ç½®Slacké€šçŸ¥**

```yaml
global:
  slack_api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'

receivers:
  - name: 'slack-notifications'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'
        channel: '#alerts'
        username: 'Alertmanager'
        icon_emoji: ':warning:'
        title: 'å‘Šè­¦é€šçŸ¥'
        text: |
          *å‘Šè­¦ï¼š* {{ .GroupLabels.alertname }}
          *çº§åˆ«ï¼š* {{ .CommonLabels.severity }}
          *çŠ¶æ€ï¼š* {{ .Status | toUpper }}
          
          *è¯¦ç»†ä¿¡æ¯ï¼š*
          {{ range .Alerts }}
          â€¢ *å®ä¾‹ï¼š* {{ .Labels.instance }}
          â€¢ *æè¿°ï¼š* {{ .Annotations.description }}
          {{ end }}
        
        # æ·»åŠ æ“ä½œæŒ‰é’®
        actions:
          - type: button
            text: 'æŸ¥çœ‹Grafana'
            url: 'http://grafana.company.com'
          - type: button
            text: 'æŸ¥çœ‹è¯¦æƒ…'
            url: '{{ .ExternalURL }}'
```

### 4.4 Slackæ¶ˆæ¯ç¾åŒ–

**âœ¨ è®©Slackæ¶ˆæ¯æ›´åŠ é†’ç›®å’Œå®ç”¨**

**ä½¿ç”¨é¢œè‰²åŒºåˆ†å‘Šè­¦çº§åˆ«**
```yaml
receivers:
  - name: 'colorful-slack'
    slack_configs:
      - channel: '#critical-alerts'
        # æ ¹æ®å‘Šè­¦çº§åˆ«è®¾ç½®é¢œè‰²
        color: '{{ if eq .CommonLabels.severity "critical" }}danger{{ else if eq .CommonLabels.severity "warning" }}warning{{ else }}good{{ end }}'
        
        title: '{{ .Status | toUpper }}: {{ .GroupLabels.alertname }}'
        
        # ä½¿ç”¨å­—æ®µæ ¼å¼åŒ–ä¿¡æ¯
        fields:
          - title: 'å‘Šè­¦çº§åˆ«'
            value: '{{ .CommonLabels.severity }}'
            short: true
          - title: 'å½±å“å®ä¾‹'
            value: '{{ .Alerts | len }} ä¸ª'
            short: true
          - title: 'å¼€å§‹æ—¶é—´'
            value: '{{ .CommonAnnotations.timestamp }}'
            short: false
        
        # æ·»åŠ é“¾æ¥
        title_link: 'http://grafana.company.com/dashboard'
```

**å¯Œæ–‡æœ¬æ ¼å¼çš„Slackæ¶ˆæ¯**
```yaml
receivers:
  - name: 'rich-slack'
    slack_configs:
      - channel: '#monitoring'
        username: 'PrometheusBot'
        icon_url: 'https://prometheus.io/assets/prometheus_logo.png'
        
        text: |
          {{ if eq .Status "firing" }}ğŸ”¥ *æ–°å¢å‘Šè­¦*{{ else }}âœ… *å‘Šè­¦æ¢å¤*{{ end }}
          
          ğŸ“‹ *å‘Šè­¦åç§°ï¼š* {{ .GroupLabels.alertname }}
          ğŸš¨ *ä¸¥é‡ç¨‹åº¦ï¼š* {{ .CommonLabels.severity | toUpper }}
          â° *è§¦å‘æ—¶é—´ï¼š* {{ .CommonAnnotations.timestamp }}
          ğŸ“Š *å®ä¾‹æ•°é‡ï¼š* {{ .Alerts | len }}
          
          ğŸ“ *è¯¦ç»†ä¿¡æ¯ï¼š*
          {{ range .Alerts }}
          â–¶ï¸ `{{ .Labels.instance }}` - {{ .Annotations.description }}
          {{ end }}
          
          ğŸ”— <http://grafana.company.com|æŸ¥çœ‹ç›‘æ§é¢æ¿>
```

---

## 5. ğŸ“± å¾®ä¿¡é€šçŸ¥é…ç½®


### 5.1 ä¼ä¸šå¾®ä¿¡é€šçŸ¥åŸç†

**ğŸ’¼ ä½¿ç”¨ä¼ä¸šå¾®ä¿¡æ¥æ”¶å‘Šè­¦**

ä¼ä¸šå¾®ä¿¡å°±åƒå…¬å¸çš„å†…éƒ¨é€šè®¯å·¥å…·ï¼Œæ¯”ä¸ªäººå¾®ä¿¡æ›´é€‚åˆå·¥ä½œåœºæ™¯ã€‚å½“ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç›´æ¥åœ¨ä¼ä¸šå¾®ä¿¡ç¾¤é‡Œæ”¶åˆ°é€šçŸ¥ï¼Œæ–¹ä¾¿å›¢é˜Ÿå¿«é€Ÿå“åº”ã€‚

### 5.2 ä¼ä¸šå¾®ä¿¡Boté…ç½®

**ğŸ¤– åˆ›å»ºä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äºº**

**æ­¥éª¤1ï¼šåˆ›å»ºç¾¤èŠæœºå™¨äºº**
1. åœ¨ä¼ä¸šå¾®ä¿¡ç¾¤ä¸­ï¼Œç‚¹å‡»å³ä¸Šè§’çš„"ç¾¤è®¾ç½®"
2. é€‰æ‹©"ç¾¤æœºå™¨äºº"
3. ç‚¹å‡»"æ·»åŠ æœºå™¨äºº"
4. è®¾ç½®æœºå™¨äººåç§°å’Œå¤´åƒ
5. å¤åˆ¶æœºå™¨äººçš„Webhookåœ°å€

**æ­¥éª¤2ï¼šåœ¨Alertmanagerä¸­é…ç½®**
```yaml
receivers:
  - name: 'wechat-work'
    wechat_configs:
      - api_url: 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY'
        to_user: '@all'  # é€šçŸ¥æ‰€æœ‰ç¾¤æˆå‘˜
        agent_id: 'your_agent_id'
        corp_id: 'your_corp_id'
        api_secret: 'your_api_secret'
        
        message: |
          å‘Šè­¦é€šçŸ¥
          
          å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}
          å‘Šè­¦çŠ¶æ€ï¼š{{ .Status }}
          å‘Šè­¦çº§åˆ«ï¼š{{ .CommonLabels.severity }}
          
          è¯¦ç»†ä¿¡æ¯ï¼š
          {{ range .Alerts }}
          å®ä¾‹ï¼š{{ .Labels.instance }}
          æè¿°ï¼š{{ .Annotations.description }}
          {{ end }}
```

### 5.3 å¾®ä¿¡é€šçŸ¥æ¨¡æ¿ä¼˜åŒ–

**ğŸ“ é’ˆå¯¹ç§»åŠ¨ç«¯ä¼˜åŒ–çš„å¾®ä¿¡æ¶ˆæ¯æ ¼å¼**

```yaml
receivers:
  - name: 'wechat-mobile'
    wechat_configs:
      - api_url: 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY'
        message: |
          ğŸš¨ {{ if eq .Status "firing" }}ç³»ç»Ÿå‘Šè­¦{{ else }}å‘Šè­¦æ¢å¤{{ end }}
          
          ğŸ“ {{ .GroupLabels.alertname }}
          {{ if eq .CommonLabels.severity "critical" }}ğŸ”´ ä¸¥é‡{{ else if eq .CommonLabels.severity "warning" }}ğŸŸ¡ è­¦å‘Š{{ else }}ğŸŸ¢ ä¿¡æ¯{{ end }}
          
          â° {{ .CommonAnnotations.timestamp }}
          
          ğŸ“Š å½±å“èŒƒå›´ï¼š
          {{ range .Alerts }}
          â€¢ {{ .Labels.instance }}
          {{ end }}
          
          ğŸ’¡ {{ .CommonAnnotations.description }}
```

---

## 6. ğŸ“Ÿ PagerDutyé€šçŸ¥é…ç½®


### 6.1 PagerDutyæœåŠ¡ä»‹ç»

**ğŸš¨ ä¸“ä¸šçš„äº‹ä»¶å“åº”å¹³å°**

PagerDutyå°±åƒä¸“ä¸šçš„å€¼ç­ç³»ç»Ÿï¼Œå½“æœ‰ç´§æ€¥æƒ…å†µæ—¶ï¼Œå®ƒä¼šæŒ‰ç…§é¢„è®¾çš„è§„åˆ™è‡ªåŠ¨æ‰¾åˆ°å½“å‰å€¼ç­çš„äººå‘˜ï¼Œé€šè¿‡ç”µè¯ã€çŸ­ä¿¡ç­‰æ–¹å¼ç¡®ä¿é€šçŸ¥é€è¾¾ã€‚

### 6.2 PagerDutyé›†æˆé…ç½®

**ğŸ”§ é…ç½®PagerDutyå‘Šè­¦é€šçŸ¥**

```yaml
receivers:
  - name: 'pagerduty-critical'
    pagerduty_configs:
      - routing_key: 'your-integration-key'
        description: '{{ .GroupLabels.alertname }}: {{ .CommonAnnotations.description }}'
        severity: '{{ .CommonLabels.severity }}'
        
        # äº‹ä»¶è¯¦æƒ…
        details:
          alert_name: '{{ .GroupLabels.alertname }}'
          instance: '{{ .CommonLabels.instance }}'
          severity: '{{ .CommonLabels.severity }}'
          timestamp: '{{ .CommonAnnotations.timestamp }}'
          
        # é“¾æ¥ä¿¡æ¯
        links:
          - href: 'http://grafana.company.com'
            text: 'æŸ¥çœ‹Grafanaä»ªè¡¨æ¿'
          - href: '{{ .ExternalURL }}'
            text: 'æŸ¥çœ‹Alertmanager'
```

**ğŸ¯ æŒ‰çº§åˆ«åˆ†é…ä¸åŒçš„PagerDutyæœåŠ¡**
```yaml
receivers:
  # ä¸¥é‡å‘Šè­¦ - ç«‹å³é€šçŸ¥å€¼ç­äººå‘˜
  - name: 'pagerduty-critical'
    pagerduty_configs:
      - routing_key: 'critical-service-key'
        severity: 'critical'
        description: 'ğŸ”´ ä¸¥é‡å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
        
  # ä¸€èˆ¬å‘Šè­¦ - å·¥ä½œæ—¶é—´é€šçŸ¥
  - name: 'pagerduty-warning'  
    pagerduty_configs:
      - routing_key: 'warning-service-key'
        severity: 'warning'
        description: 'ğŸŸ¡ è­¦å‘Šå‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
```

---

## 7. ğŸ” é€šçŸ¥è®¤è¯ä¸å®‰å…¨


### 7.1 é€šçŸ¥æ¸ é“çš„å®‰å…¨è€ƒè™‘

**ğŸ›¡ï¸ ä¿æŠ¤å‘Šè­¦é€šçŸ¥çš„å®‰å…¨æ€§**

å‘Šè­¦é€šçŸ¥å¯èƒ½åŒ…å«æ•æ„Ÿçš„ç³»ç»Ÿä¿¡æ¯ï¼Œå°±åƒå®¶é‡Œçš„é—¨ç¦ç³»ç»Ÿï¼Œéœ€è¦ç¡®ä¿åªæœ‰æˆæƒçš„äººæ‰èƒ½æ”¶åˆ°é€šçŸ¥ï¼Œé¿å…ä¿¡æ¯æ³„éœ²ã€‚

### 7.2 è®¤è¯é…ç½®æœ€ä½³å®è·µ

**ğŸ”‘ å„ç§è®¤è¯æ–¹å¼çš„é…ç½®**

**Basic Authè®¤è¯**
```yaml
receivers:
  - name: 'secure-webhook'
    webhook_configs:
      - url: 'https://api.company.com/alerts'
        http_config:
          basic_auth:
            username: 'alert_user'
            password_file: '/etc/alertmanager/webhook_password'
          tls_config:
            ca_file: '/etc/ssl/ca.pem'
            cert_file: '/etc/ssl/client.pem'
            key_file: '/etc/ssl/client.key'
            insecure_skip_verify: false
```

**Bearer Tokenè®¤è¯**
```yaml
receivers:
  - name: 'token-auth'
    webhook_configs:
      - url: 'https://api.company.com/alerts'
        http_config:
          bearer_token_file: '/etc/alertmanager/token'
          proxy_url: 'http://proxy:8080'
```

**OAuth2è®¤è¯**
```yaml
receivers:
  - name: 'oauth2-webhook'
    webhook_configs:
      - url: 'https://api.company.com/alerts'
        http_config:
          oauth2:
            client_id: 'your_client_id'
            client_secret_file: '/etc/alertmanager/oauth_secret'
            token_url: 'https://auth.company.com/oauth/token'
            scopes: ['alerts:write']
```

### 7.3 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

**ğŸ”’ é˜²æ­¢æ•æ„Ÿä¿¡æ¯åœ¨é€šçŸ¥ä¸­æ³„éœ²**

**è¿‡æ»¤æ•æ„Ÿæ ‡ç­¾**
```yaml
receivers:
  - name: 'filtered-notifications'
    email_configs:
      - to: 'external-team@partner.com'
        subject: 'å¤–éƒ¨å‘Šè­¦é€šçŸ¥'
        body: |
          å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}
          å‘Šè­¦çº§åˆ«ï¼š{{ .CommonLabels.severity }}
          
          # ä¸åŒ…å«å…·ä½“çš„æœåŠ¡å™¨IPå’Œå†…éƒ¨ä¿¡æ¯
          å½±å“æœåŠ¡ï¼š{{ .CommonLabels.service }}
          å¤§è‡´æ—¶é—´ï¼š{{ .CommonAnnotations.timestamp }}
```

**ä½¿ç”¨æ¨¡æ¿å˜é‡è¿‡æ»¤**
```yaml
# å®šä¹‰å®‰å…¨çš„é€šçŸ¥æ¨¡æ¿
templates:
  - '/etc/alertmanager/templates/secure.tmpl'

receivers:
  - name: 'secure-notifications'
    slack_configs:
      - channel: '#public-alerts'
        text: '{{ template "secure.alert" . }}'
```

---

## 8. â±ï¸ é€šçŸ¥é‡è¯•ä¸è¶…æ—¶æœºåˆ¶


### 8.1 é‡è¯•æœºåˆ¶çš„é‡è¦æ€§

**ğŸ”„ ç¡®ä¿é‡è¦é€šçŸ¥ä¸ä¼šä¸¢å¤±**

ç½‘ç»œå°±åƒå¿«é€’é…é€ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°å µè½¦æˆ–å…¶ä»–é—®é¢˜å¯¼è‡´é…é€å¤±è´¥ã€‚é€šçŸ¥é‡è¯•æœºåˆ¶å°±åƒå¿«é€’å‘˜ä¼šå¤šæ¬¡å°è¯•é…é€ï¼Œç¡®ä¿é‡è¦çš„å‘Šè­¦é€šçŸ¥èƒ½å¤ŸæˆåŠŸé€è¾¾ã€‚

### 8.2 è¶…æ—¶é…ç½®

**â° è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´**

```yaml
global:
  # å…¨å±€HTTPé…ç½®
  http_config:
    # å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´
    dial_timeout: 30s
    # æ•´ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´  
    timeout: 60s
    # TLSæ¡æ‰‹è¶…æ—¶æ—¶é—´
    tls_handshake_timeout: 10s
    # æœŸæœ›çš„å“åº”çŠ¶æ€ç 
    expect_continue_timeout: 1s

receivers:
  - name: 'timeout-configured'
    webhook_configs:
      - url: 'https://slow-api.com/alerts'
        http_config:
          # è¦†ç›–å…¨å±€é…ç½®
          timeout: 30s
        # æœ€å¤§å‘Šè­¦æ•°é‡
        max_alerts: 10
```

### 8.3 é‡è¯•ç­–ç•¥é…ç½®

**ğŸ” æ™ºèƒ½é‡è¯•é¿å…é€šçŸ¥ä¸¢å¤±**

è™½ç„¶Alertmanageræœ¬èº«ä¸ç›´æ¥æä¾›é‡è¯•é…ç½®ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

**åœ¨æ¥æ”¶ç«¯å®ç°é‡è¯•é€»è¾‘**
```python
# webhookæ¥æ”¶ç«¯é‡è¯•ç¤ºä¾‹
import requests
import time
from functools import wraps

def retry_on_failure(max_retries=3, delay=5):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for attempt in range(max_retries):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    if attempt == max_retries - 1:
                        raise e
                    print(f"å°è¯• {attempt + 1} å¤±è´¥ï¼Œ{delay}ç§’åé‡è¯•...")
                    time.sleep(delay)
            return None
        return wrapper
    return decorator

@retry_on_failure(max_retries=3, delay=10)
def send_to_external_system(alert_data):
    """å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œå¸¦é‡è¯•æœºåˆ¶"""
    response = requests.post(
        'https://external-api.com/alerts',
        json=alert_data,
        timeout=30
    )
    response.raise_for_status()
    return response
```

### 8.4 æ‰¹é‡é€šçŸ¥å¤„ç†

**ğŸ“¦ æé«˜é€šçŸ¥æ•ˆç‡çš„æ‰¹é‡å¤„ç†**

```yaml
route:
  # åˆ†ç»„é…ç½®å½±å“æ‰¹é‡å¤„ç†
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s      # ç­‰å¾…30ç§’æ”¶é›†åŒç»„å‘Šè­¦
  group_interval: 5m   # åŒç»„åç»­å‘Šè­¦é—´éš”5åˆ†é’Ÿå‘é€
  repeat_interval: 12h # æœªè§£å†³å‘Šè­¦12å°æ—¶é‡å¤å‘é€

receivers:
  - name: 'batch-processor'
    webhook_configs:
      - url: 'https://batch-api.com/alerts'
        max_alerts: 20  # æ¯æ¬¡æœ€å¤šå‘é€20ä¸ªå‘Šè­¦
        send_resolved: true
```

**ğŸ’¡ æ‰¹é‡å¤„ç†çš„ä¼˜åŠ¿**
```
ç½‘ç»œæ•ˆç‡ï¼šå‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°
å¤„ç†æ•ˆç‡ï¼šæ‰¹é‡å¤„ç†æ¯”å•æ¡å¤„ç†æ›´é«˜æ•ˆ
èµ„æºèŠ‚çº¦ï¼šå‡å°‘ç³»ç»Ÿèµ„æºæ¶ˆè€—
ç”¨æˆ·ä½“éªŒï¼šé¿å…é€šçŸ¥è½°ç‚¸ï¼Œä¿¡æ¯æ›´é›†ä¸­
```

---

## 9. ğŸ”„ å¤šæ¸ é“ç»„åˆç­–ç•¥


### 9.1 æ¸ é“ä¼˜å…ˆçº§è®¾è®¡

**ğŸ¯ æ ¹æ®å‘Šè­¦é‡è¦æ€§é€‰æ‹©é€šçŸ¥æ¸ é“**

å°±åƒç´§æ€¥æƒ…å†µä¸‹çš„è”ç³»æ–¹å¼ï¼Œä¸€èˆ¬é—®é¢˜å‘é‚®ä»¶å°±å¤Ÿäº†ï¼Œç´§æ€¥é—®é¢˜éœ€è¦æ‰“ç”µè¯ï¼Œç‰¹åˆ«ç´§æ€¥çš„è¿˜è¦å‘çŸ­ä¿¡ç¡®ä¿æ”¶åˆ°ã€‚

### 9.2 æŒ‰çº§åˆ«åˆ†é…æ¸ é“

**ğŸ“Š ä¸åŒå‘Šè­¦çº§åˆ«çš„é€šçŸ¥ç­–ç•¥**

```yaml
route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default'
  
  routes:
    # ä¸¥é‡å‘Šè­¦ï¼šå¤šæ¸ é“é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-multi-channel'
      repeat_interval: 15m
      
    # è­¦å‘Šå‘Šè­¦ï¼šå·¥ä½œæ—¶é—´Slackï¼Œéå·¥ä½œæ—¶é—´é‚®ä»¶
    - match:
        severity: warning
      receiver: 'warning-conditional'
      
    # ä¿¡æ¯å‘Šè­¦ï¼šä»…é‚®ä»¶
    - match:
        severity: info
      receiver: 'info-email-only'

receivers:
  # ä¸¥é‡å‘Šè­¦å¤šæ¸ é“é€šçŸ¥
  - name: 'critical-multi-channel'
    email_configs:
      - to: 'oncall@company.com'
        subject: 'ğŸ”´ ä¸¥é‡å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
    slack_configs:
      - channel: '#critical-alerts'
        color: 'danger'
        title: 'ğŸš¨ ä¸¥é‡å‘Šè­¦'
    pagerduty_configs:
      - routing_key: 'critical-service-key'
        description: 'CRITICAL: {{ .GroupLabels.alertname }}'
    
  # è­¦å‘Šå‘Šè­¦æ¡ä»¶é€šçŸ¥
  - name: 'warning-conditional'
    slack_configs:
      - channel: '#alerts'
        color: 'warning'
    email_configs:
      - to: 'team@company.com'
        subject: 'âš ï¸ è­¦å‘Šï¼š{{ .GroupLabels.alertname }}'
```

### 9.3 æ—¶é—´æ®µè·¯ç”±ç­–ç•¥

**ğŸ• æ ¹æ®æ—¶é—´é€‰æ‹©ä¸åŒé€šçŸ¥æ–¹å¼**

è™½ç„¶Alertmanagerä¸ç›´æ¥æ”¯æŒæ—¶é—´è·¯ç”±ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

**ä½¿ç”¨å¤–éƒ¨è·¯ç”±æœåŠ¡**
```python
# æ—¶é—´æ„ŸçŸ¥çš„è·¯ç”±æœåŠ¡
from datetime import datetime
import requests

def route_alert_by_time(alert_data):
    current_hour = datetime.now().hour
    
    # å·¥ä½œæ—¶é—´ (9-18ç‚¹)
    if 9 <= current_hour <= 18:
        # å‘é€åˆ°Slack
        send_to_slack(alert_data)
    else:
        # éå·¥ä½œæ—¶é—´å‘é€é‚®ä»¶å’ŒçŸ­ä¿¡
        send_email(alert_data)
        if alert_data.get('severity') == 'critical':
            send_sms(alert_data)

def send_to_slack(alert_data):
    requests.post('https://hooks.slack.com/your-webhook', json=alert_data)

def send_email(alert_data):
    # å‘é€é‚®ä»¶é€»è¾‘
    pass

def send_sms(alert_data):
    # å‘é€çŸ­ä¿¡é€»è¾‘
    pass
```

### 9.4 æ•…éšœè½¬ç§»æœºåˆ¶

**ğŸ”„ å½“ä¸»è¦é€šçŸ¥æ¸ é“å¤±è´¥æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ**

```yaml
receivers:
  - name: 'failover-notifications'
    # ä¸»è¦é€šçŸ¥æ¸ é“ï¼šSlack
    slack_configs:
      - api_url: 'https://hooks.slack.com/primary'
        channel: '#alerts'
        send_resolved: true
        
    # å¤‡ä»½é€šçŸ¥æ¸ é“ï¼šé‚®ä»¶
    email_configs:
      - to: 'backup@company.com'
        subject: '[å¤‡ä»½é€šçŸ¥] {{ .GroupLabels.alertname }}'
        
    # æœ€åä¿éšœï¼šWebhookåˆ°å†…éƒ¨ç³»ç»Ÿ
    webhook_configs:
      - url: 'http://internal-alert-system.com/webhook'
        http_config:
          timeout: 10s
```

**ğŸ’¡ æ•…éšœè½¬ç§»çš„å®ç°æ€è·¯**
```
å±‚çº§é€šçŸ¥ç­–ç•¥ï¼š
ç¬¬1å±‚ï¼šä¸»è¦æ¸ é“ï¼ˆSlack/ä¼ä¸šå¾®ä¿¡ï¼‰
ç¬¬2å±‚ï¼šé‚®ä»¶é€šçŸ¥ï¼ˆå¯é æ€§é«˜ï¼‰
ç¬¬3å±‚ï¼šå†…éƒ¨ç³»ç»Ÿå­˜å‚¨ï¼ˆç¡®ä¿ä¸ä¸¢å¤±ï¼‰
ç¬¬4å±‚ï¼šçŸ­ä¿¡/ç”µè¯ï¼ˆç´§æ€¥æƒ…å†µï¼‰

ç›‘æ§é€šçŸ¥æ¸ é“å¥åº·çŠ¶æ€ï¼š
å®šæœŸæµ‹è¯•å„ä¸ªé€šçŸ¥æ¸ é“
è®°å½•é€šçŸ¥æˆåŠŸå¤±è´¥ç‡
è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ¸ é“
```

---

## 10. ğŸ§ª é€šçŸ¥æµ‹è¯•ä¸æ•…éšœæ’é™¤


### 10.1 é€šçŸ¥æ¸ é“æµ‹è¯•

**âœ… ç¡®ä¿é€šçŸ¥é…ç½®æ­£ç¡®å·¥ä½œ**

æµ‹è¯•é€šçŸ¥å°±åƒæµ‹è¯•ç«è­¦æŠ¥è­¦å™¨ï¼Œå¹³æ—¶è¦å®šæœŸæ£€æŸ¥ç¡®ä¿å…³é”®æ—¶åˆ»èƒ½æ­£å¸¸å·¥ä½œã€‚

### 10.2 æ‰‹åŠ¨æµ‹è¯•æ–¹æ³•

**ğŸ”§ ç®€å•çš„é€šçŸ¥æµ‹è¯•æ­¥éª¤**

**ä½¿ç”¨amtoolæµ‹è¯•**
```bash
# å®‰è£…amtoolï¼ˆAlertmanagerå·¥å…·ï¼‰
go install github.com/prometheus/alertmanager/cmd/amtool@latest

# é…ç½®amtool
cat > ~/.config/amtool/config.yml << EOF
alertmanager.url: "http://localhost:9093"
EOF

# å‘é€æµ‹è¯•å‘Šè­¦
amtool alert add \
  alertname="TestAlert" \
  instance="test-server" \
  severity="warning" \
  description="è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å‘Šè­¦" \
  --end=$(date -d '+5 minutes' --iso-8601)

# æŸ¥çœ‹å‘Šè­¦çŠ¶æ€
amtool alert query
```

**ä½¿ç”¨curlå‘é€æµ‹è¯•å‘Šè­¦**
```bash
# ç›´æ¥å‘Alertmanager APIå‘é€å‘Šè­¦
curl -X POST http://localhost:9093/api/v1/alerts \
  -H "Content-Type: application/json" \
  -d '[
    {
      "labels": {
        "alertname": "TestNotification",
        "instance": "test-instance",
        "severity": "warning",
        "service": "test-service"
      },
      "annotations": {
        "description": "è¿™æ˜¯é€šçŸ¥æ¸ é“æµ‹è¯•",
        "summary": "æµ‹è¯•å‘Šè­¦é€šçŸ¥åŠŸèƒ½"
      },
      "startsAt": "'$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)'",
      "endsAt": "'$(date -u -d '+5 minutes' +%Y-%m-%dT%H:%M:%S.%3NZ)'"
    }
  ]'
```

### 10.3 è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

**ğŸ¤– å®šæœŸè‡ªåŠ¨æµ‹è¯•é€šçŸ¥åŠŸèƒ½**

```bash
#!/bin/bash
# notification_test.sh - é€šçŸ¥æ¸ é“æµ‹è¯•è„šæœ¬

ALERTMANAGER_URL="http://localhost:9093"
TEST_RESULTS="/tmp/notification_test_results.txt"

echo "å¼€å§‹é€šçŸ¥æ¸ é“æµ‹è¯• - $(date)" > $TEST_RESULTS

# æµ‹è¯•å‡½æ•°
test_notification_channel() {
    local channel_name=$1
    local test_labels=$2
    
    echo "æµ‹è¯• $channel_name é€šçŸ¥æ¸ é“..." | tee -a $TEST_RESULTS
    
    # å‘é€æµ‹è¯•å‘Šè­¦
    curl -s -X POST $ALERTMANAGER_URL/api/v1/alerts \
      -H "Content-Type: application/json" \
      -d "$test_labels" > /dev/null
    
    if [ $? -eq 0 ]; then
        echo "âœ… $channel_name: å‘Šè­¦å‘é€æˆåŠŸ" | tee -a $TEST_RESULTS
    else
        echo "âŒ $channel_name: å‘Šè­¦å‘é€å¤±è´¥" | tee -a $TEST_RESULTS
    fi
    
    sleep 5  # ç­‰å¾…å¤„ç†
}

# æµ‹è¯•é‚®ä»¶é€šçŸ¥
test_notification_channel "é‚®ä»¶é€šçŸ¥" '[{
  "labels": {
    "alertname": "EmailTest",
    "severity": "info",
    "test_type": "email"
  },
  "annotations": {
    "description": "é‚®ä»¶é€šçŸ¥æµ‹è¯•",
    "summary": "æµ‹è¯•é‚®ä»¶é€šçŸ¥åŠŸèƒ½"
  },
  "startsAt": "'$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)'",
  "endsAt": "'$(date -u -d '+2 minutes' +%Y-%m-%dT%H:%M:%S.%3NZ)'"
}]'

# æµ‹è¯•Slacké€šçŸ¥
test_notification_channel "Slacké€šçŸ¥" '[{
  "labels": {
    "alertname": "SlackTest",
    "severity": "warning",
    "test_type": "slack"
  },
  "annotations": {
    "description": "Slacké€šçŸ¥æµ‹è¯•",
    "summary": "æµ‹è¯•Slacké€šçŸ¥åŠŸèƒ½"
  },
  "startsAt": "'$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)'",
  "endsAt": "'$(date -u -d '+2 minutes' +%Y-%m-%dT%H:%M:%S.%3NZ)'"
}]'

# æµ‹è¯•Webhooké€šçŸ¥
test_notification_channel "Webhooké€šçŸ¥" '[{
  "labels": {
    "alertname": "WebhookTest",
    "severity": "critical",
    "test_type": "webhook"
  },
  "annotations": {
    "description": "Webhooké€šçŸ¥æµ‹è¯•",
    "summary": "æµ‹è¯•Webhooké€šçŸ¥åŠŸèƒ½"
  },
  "startsAt": "'$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)'",
  "endsAt": "'$(date -u -d '+2 minutes' +%Y-%m-%dT%H:%M:%S.%3NZ)'"
}]'

echo "é€šçŸ¥æ¸ é“æµ‹è¯•å®Œæˆ - $(date)" | tee -a $TEST_RESULTS

# å‘é€æµ‹è¯•ç»“æœ
mail -s "é€šçŸ¥æ¸ é“æµ‹è¯•ç»“æœ" admin@company.com < $TEST_RESULTS
```

### 10.4 æ•…éšœæ’é™¤æŒ‡å—

**ğŸ” å¸¸è§é€šçŸ¥é—®é¢˜çš„è¯Šæ–­å’Œè§£å†³**

**é—®é¢˜1ï¼šé‚®ä»¶é€šçŸ¥ä¸å·¥ä½œ**
```bash
# æ£€æŸ¥SMTPé…ç½®
curl -v telnet://smtp.gmail.com:587

# æµ‹è¯•SMTPè®¤è¯
openssl s_client -connect smtp.gmail.com:587 -starttls smtp

# æŸ¥çœ‹Alertmanageræ—¥å¿—
tail -f /var/log/alertmanager/alertmanager.log | grep email

# å¸¸è§è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥SMTPæœåŠ¡å™¨åœ°å€å’Œç«¯å£
# 2. ç¡®è®¤ç”¨æˆ·åå¯†ç æ­£ç¡®
# 3. æ£€æŸ¥æ˜¯å¦éœ€è¦åº”ç”¨ä¸“ç”¨å¯†ç 
# 4. ç¡®è®¤TLSè®¾ç½®æ­£ç¡®
```

**é—®é¢˜2ï¼šSlacké€šçŸ¥å¤±è´¥**
```bash
# æµ‹è¯•Slack Webhook URL
curl -X POST -H 'Content-type: application/json' \
  --data '{"text":"æµ‹è¯•æ¶ˆæ¯"}' \
  YOUR_SLACK_WEBHOOK_URL

# æ£€æŸ¥Slack Appæƒé™
# 1. ç¡®è®¤Incoming Webhookså·²å¯ç”¨
# 2. æ£€æŸ¥é¢‘é“æƒé™
# 3. éªŒè¯Webhook URLæ­£ç¡®

# æŸ¥çœ‹Alertmanager Slackç›¸å…³æ—¥å¿—
grep -i slack /var/log/alertmanager/alertmanager.log
```

**é—®é¢˜3ï¼šWebhookæ¥æ”¶ä¸åˆ°æ•°æ®**
```bash
# ä½¿ç”¨netcatç›‘å¬æµ‹è¯•
nc -l 8080

# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
curl -v http://your-webhook-endpoint/alerts

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
iptables -L | grep 8080
firewall-cmd --list-ports

# éªŒè¯WebhookæœåŠ¡çŠ¶æ€
systemctl status your-webhook-service
```

**ğŸ“‹ æ•…éšœæ’é™¤æ£€æŸ¥æ¸…å•**
```
ç½‘ç»œè¿æ¥ï¼š
â–¡ ç›®æ ‡æœåŠ¡å™¨å¯è¾¾
â–¡ ç«¯å£å¼€æ”¾
â–¡ é˜²ç«å¢™è§„åˆ™æ­£ç¡®
â–¡ DNSè§£ææ­£å¸¸

è®¤è¯é…ç½®ï¼š
â–¡ ç”¨æˆ·åå¯†ç æ­£ç¡®
â–¡ Tokenæœªè¿‡æœŸ
â–¡ æƒé™è®¾ç½®æ­£ç¡®
â–¡ TLSè¯ä¹¦æœ‰æ•ˆ

é…ç½®æ–‡ä»¶ï¼š
â–¡ YAMLè¯­æ³•æ­£ç¡®
â–¡ ç¼©è¿›æ ¼å¼æ­£ç¡®
â–¡ ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰
â–¡ æ¨¡æ¿å˜é‡æ­£ç¡®

æœåŠ¡çŠ¶æ€ï¼š
â–¡ AlertmanageræœåŠ¡è¿è¡Œ
â–¡ ç›®æ ‡æœåŠ¡æ­£å¸¸
â–¡ æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯
â–¡ èµ„æºä½¿ç”¨æ­£å¸¸
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é€šçŸ¥æ¸ é“ï¼šå‘Šè­¦ä¿¡æ¯ä¼ é€’çš„ä¸åŒæ–¹å¼å’Œé€”å¾„
ğŸ”¸ é‚®ä»¶é€šçŸ¥ï¼šæœ€åŸºç¡€å¯é çš„é€šçŸ¥æ–¹å¼ï¼Œé€‚åˆæ­£å¼åœºæ™¯
ğŸ”¸ Webhooké€šçŸ¥ï¼šçµæ´»çš„é›†æˆæ–¹å¼ï¼Œæ”¯æŒè‡ªå®šä¹‰å¤„ç†é€»è¾‘
ğŸ”¸ Slacké€šçŸ¥ï¼šå›¢é˜Ÿåä½œåœºæ™¯ä¸‹çš„å®æ—¶é€šçŸ¥å·¥å…·
ğŸ”¸ å¾®ä¿¡é€šçŸ¥ï¼šä¼ä¸šå†…éƒ¨æ²Ÿé€šçš„ä¾¿æ·é€šçŸ¥æ–¹å¼
ğŸ”¸ å¤šæ¸ é“ç»„åˆï¼šæ ¹æ®å‘Šè­¦çº§åˆ«å’Œåœºæ™¯é€‰æ‹©æœ€ä½³é€šçŸ¥ç­–ç•¥
ğŸ”¸ å®‰å…¨è®¤è¯ï¼šä¿æŠ¤é€šçŸ¥æ¸ é“å’Œæ•æ„Ÿä¿¡æ¯å®‰å…¨
ğŸ”¸ æµ‹è¯•éªŒè¯ï¼šç¡®ä¿é€šçŸ¥æ¸ é“åœ¨å…³é”®æ—¶åˆ»èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é€šçŸ¥æ¸ é“é€‰æ‹©çš„è€ƒè™‘å› ç´ **
```
å®æ—¶æ€§è¦æ±‚ï¼š
- å³æ—¶é€šçŸ¥ï¼šSlackã€ä¼ä¸šå¾®ä¿¡
- å»¶è¿Ÿå¯æ¥å—ï¼šé‚®ä»¶é€šçŸ¥
- ç´§æ€¥æƒ…å†µï¼šçŸ­ä¿¡ã€ç”µè¯

å—ä¼—ç‰¹ç‚¹ï¼š
- æŠ€æœ¯å›¢é˜Ÿï¼šSlackã€GitHubé›†æˆ
- ç®¡ç†å±‚ï¼šé‚®ä»¶æ‘˜è¦æŠ¥å‘Š
- è¿ç»´å›¢é˜Ÿï¼šPagerDutyè½®ç­åˆ¶
- å¤–éƒ¨åˆä½œï¼šé‚®ä»¶æ­£å¼é€šçŸ¥

å¯é æ€§éœ€æ±‚ï¼š
- å…³é”®ä¸šåŠ¡ï¼šå¤šæ¸ é“å†—ä½™
- ä¸€èˆ¬ç›‘æ§ï¼šå•ä¸€å¯é æ¸ é“
- æµ‹è¯•ç¯å¢ƒï¼šç®€å•é‚®ä»¶å³å¯
```

**ğŸ”¹ é€šçŸ¥æ¨¡æ¿è®¾è®¡åŸåˆ™**
```
ä¿¡æ¯å®Œæ•´æ€§ï¼š
- å‘Šè­¦åç§°å’Œçº§åˆ«
- å½±å“èŒƒå›´å’Œå®ä¾‹
- å¼€å§‹æ—¶é—´å’ŒæŒç»­æ—¶é•¿
- å¯èƒ½çš„å½±å“å’Œå»ºè®®æ“ä½œ

å¯è¯»æ€§ä¼˜åŒ–ï¼š
- ç§»åŠ¨ç«¯å‹å¥½æ ¼å¼
- é‡è¦ä¿¡æ¯çªå‡ºæ˜¾ç¤º
- ä½¿ç”¨emojiå¢å¼ºè§†è§‰æ•ˆæœ
- é¿å…æŠ€æœ¯æœ¯è¯­è¿‡å¤š

æ“ä½œä¾¿åˆ©æ€§ï¼š
- æä¾›ç›¸å…³é“¾æ¥
- åŒ…å«å¤„ç†å»ºè®®
- æ”¯æŒå¿«é€Ÿå“åº”
- ä¾¿äºé—®é¢˜è·Ÿè¸ª
```

**ğŸ”¹ å¤šæ¸ é“ç­–ç•¥çš„æœ€ä½³å®è·µ**
```
åˆ†å±‚é€šçŸ¥ç­–ç•¥ï¼š
ç¬¬1å±‚ï¼šå³æ—¶é€šçŸ¥ï¼ˆSlack/å¾®ä¿¡ï¼‰
ç¬¬2å±‚ï¼šæ­£å¼é€šçŸ¥ï¼ˆé‚®ä»¶ï¼‰
ç¬¬3å±‚ï¼šæŒä¹…åŒ–è®°å½•ï¼ˆæ•°æ®åº“/æ—¥å¿—ï¼‰
ç¬¬4å±‚ï¼šç´§æ€¥è”ç³»ï¼ˆçŸ­ä¿¡/ç”µè¯ï¼‰

æ¸ é“æ•…éšœè½¬ç§»ï¼š
ä¸»æ¸ é“å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æ¸ é“
å®šæœŸæµ‹è¯•å„æ¸ é“å¯ç”¨æ€§
ç›‘æ§é€šçŸ¥å‘é€æˆåŠŸç‡

é¿å…é€šçŸ¥ç–²åŠ³ï¼š
åˆç†è®¾ç½®é€šçŸ¥é¢‘ç‡
é¿å…é‡å¤é€šçŸ¥
æŒ‰é‡è¦æ€§è¿‡æ»¤ä¿¡æ¯
æä¾›é€šçŸ¥é™é»˜åŠŸèƒ½
```

### 11.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒåº”ç”¨åœºæ™¯**
- **ç”µå•†å¹³å°**ï¼šæ”¯ä»˜ç³»ç»Ÿæ•…éšœæ—¶å¤šæ¸ é“ç´§æ€¥é€šçŸ¥
- **é‡‘èç³»ç»Ÿ**ï¼šäº¤æ˜“å¼‚å¸¸æ—¶åˆè§„é€šçŸ¥å’Œå³æ—¶å“åº”
- **äº’è”ç½‘æœåŠ¡**ï¼šç”¨æˆ·è®¿é—®é—®é¢˜æ—¶å¿«é€Ÿå›¢é˜Ÿåä½œ
- **ä¼ä¸šIT**ï¼šåŸºç¡€è®¾æ–½é—®é¢˜æ—¶åˆ†å±‚çº§é€šçŸ¥ç®¡ç†

**ğŸ”§ è¿ç»´å®è·µå»ºè®®**
- **æ¸è¿›éƒ¨ç½²**ï¼šä»ç®€å•é‚®ä»¶å¼€å§‹ï¼Œé€æ­¥å¢åŠ å¤æ‚æ¸ é“
- **æ¨¡æ¿æ ‡å‡†åŒ–**ï¼šå»ºç«‹ç»Ÿä¸€çš„é€šçŸ¥æ¨¡æ¿å’Œæ ¼å¼è§„èŒƒ
- **å®šæœŸæµ‹è¯•**ï¼šå»ºç«‹è‡ªåŠ¨åŒ–æµ‹è¯•ç¡®ä¿é€šçŸ¥æ¸ é“å¯ç”¨
- **å®‰å…¨é˜²æŠ¤**ï¼šä¿æŠ¤é€šçŸ¥å†…å®¹å’Œè®¤è¯ä¿¡æ¯å®‰å…¨

**ğŸ“ˆ æŠ€æœ¯å‘å±•è¶‹åŠ¿**
- **æ™ºèƒ½åŒ–é€šçŸ¥**ï¼šæ ¹æ®å†å²æ•°æ®æ™ºèƒ½é€‰æ‹©é€šçŸ¥æ–¹å¼
- **å¤šåª’ä½“æ”¯æŒ**ï¼šè¯­éŸ³ã€è§†é¢‘ç­‰å¯Œåª’ä½“é€šçŸ¥å½¢å¼
- **AIè¾…åŠ©**ï¼šæ™ºèƒ½åˆ†æå‘Šè­¦å†…å®¹ç”Ÿæˆé’ˆå¯¹æ€§é€šçŸ¥
- **ç»Ÿä¸€å¹³å°**ï¼šè·¨å¹³å°ç»Ÿä¸€çš„é€šçŸ¥ç®¡ç†ä¸­å¿ƒ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é€šçŸ¥æ¸ é“å¤šæ ·åŒ–ï¼ŒæŒ‰éœ€é€‰æ‹©æœ€é€‚åˆ
- é‚®ä»¶åŸºç¡€è¦é…å¥½ï¼ŒWebhookçµæ´»å¯é›†æˆ
- Slackå¾®ä¿¡å›¢é˜Ÿç”¨ï¼Œç´§æ€¥æƒ…å†µå¤šæ¸ é“
- å®‰å…¨è®¤è¯è¦åšå¥½ï¼Œå®šæœŸæµ‹è¯•ä¿å¯ç”¨