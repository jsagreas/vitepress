---
title: 1ã€ExporteråŸºç¡€æ¦‚å¿µä¸ŽåŽŸç†
---
## ðŸ“š ç›®å½•

1. [Exporteræ˜¯ä»€ä¹ˆ](#1-Exporteræ˜¯ä»€ä¹ˆ)
2. [å·¥ä½œåŽŸç†è¯¦è§£](#2-å·¥ä½œåŽŸç†è¯¦è§£)
3. [Pullæ¨¡å¼vs Pushæ¨¡å¼](#3-Pullæ¨¡å¼vs-Pushæ¨¡å¼)
4. [æŒ‡æ ‡æš´éœ²æœºåˆ¶](#4-æŒ‡æ ‡æš´éœ²æœºåˆ¶)
5. [æ•°æ®æ ¼å¼ä¸Žè§„èŒƒ](#5-æ•°æ®æ ¼å¼ä¸Žè§„èŒƒ)
6. [Exporteråˆ†ç±»](#6-Exporteråˆ†ç±»)
7. [æ€§èƒ½ä¸Žéƒ¨ç½²è€ƒè™‘](#7-æ€§èƒ½ä¸Žéƒ¨ç½²è€ƒè™‘)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ Exporteræ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£Exporter


**ç®€å•æ¥è¯´**ï¼šExporterå°±åƒæ˜¯ä¸€ä¸ª"ç¿»è¯‘å®˜"ï¼Œå®ƒçš„å·¥ä½œæ˜¯æŠŠå„ç§ç³»ç»Ÿçš„è¿è¡Œæ•°æ®ç¿»è¯‘æˆPrometheusèƒ½çœ‹æ‡‚çš„æ ¼å¼ã€‚

```
çœŸå®žåœºæ™¯ç±»æ¯”ï¼š
åŒ»é™¢ä½“æ£€ â†’ ä½“æ£€æŠ¥å‘Šå• â†’ åŒ»ç”Ÿè¯Šæ–­
ç³»ç»Ÿè¿è¡Œ â†’ Exporteræ”¶é›† â†’ Prometheusç›‘æŽ§

Exporterå°±æ˜¯é‚£ä¸ª"ä½“æ£€è®¾å¤‡"ï¼Œè´Ÿè´£æ”¶é›†ç³»ç»Ÿçš„å„é¡¹æŒ‡æ ‡
```

**ðŸ”¸ æ ¸å¿ƒä½œç”¨**
- **æ•°æ®æ”¶é›†å™¨**ï¼šä»Žç›®æ ‡ç³»ç»Ÿæ”¶é›†è¿è¡ŒæŒ‡æ ‡
- **æ ¼å¼è½¬æ¢å™¨**ï¼šå°†åŽŸå§‹æ•°æ®è½¬æ¢ä¸ºPrometheusæ ‡å‡†æ ¼å¼
- **HTTPæœåŠ¡**ï¼šé€šè¿‡ç½‘ç»œæŽ¥å£æš´éœ²æŒ‡æ ‡æ•°æ®
- **æ¡¥æ¢è§’è‰²**ï¼šè¿žæŽ¥è¢«ç›‘æŽ§ç³»ç»Ÿä¸ŽPrometheusæœåŠ¡ç«¯

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Exporter


**çŽ°å®žé—®é¢˜**ï¼šä¸åŒç³»ç»Ÿæœ‰ä¸åŒçš„æ•°æ®æ ¼å¼
```
MySQLæ•°æ®åº“ â†’ SQLæŸ¥è¯¢ç»“æžœ
Redisç¼“å­˜ â†’ INFOå‘½ä»¤è¾“å‡º
Linuxç³»ç»Ÿ â†’ /procæ–‡ä»¶ç³»ç»Ÿ
åº”ç”¨ç¨‹åº â†’ æ—¥å¿—æ–‡ä»¶æˆ–APIæŽ¥å£

è¿™äº›æ•°æ®æ ¼å¼éƒ½ä¸ä¸€æ ·ï¼ŒPrometheusæ— æ³•ç›´æŽ¥ç†è§£
```

**è§£å†³æ–¹æ¡ˆ**ï¼šExporterç»Ÿä¸€æ•°æ®æ ¼å¼
```
å„ç§ç³»ç»Ÿ â†’ å¯¹åº”Exporter â†’ ç»Ÿä¸€metricsæ ¼å¼ â†’ Prometheusæ”¶é›†

å°±åƒç»™ä¸åŒè¯­è¨€é…å¤‡ç¿»è¯‘ï¼Œæœ€ç»ˆéƒ½è¯´"æ™®é€šè¯"
```

### 1.3 Exporterçš„æ ¸å¿ƒç‰¹å¾


**ðŸ”¹ è¢«åŠ¨æœåŠ¡æ¨¡å¼**
- Exporterä¸ä¸»åŠ¨æŽ¨é€æ•°æ®
- ç­‰å¾…Prometheusæ¥"è¯¢é—®"ï¼ˆæŠ“å–ï¼‰
- å°±åƒåº—é“ºç­‰å®¢æˆ·ä¸Šé—¨ï¼Œè€Œä¸æ˜¯ä¸»åŠ¨æŽ¨é”€

**ðŸ”¹ æ ‡å‡†åŒ–è¾“å‡º**
- ç»Ÿä¸€çš„HTTPæŽ¥å£ï¼š`/metrics`
- æ ‡å‡†çš„æ•°æ®æ ¼å¼ï¼šExposition Format
- å›ºå®šçš„ç«¯å£çº¦å®šï¼šé€šå¸¸ä½¿ç”¨ç‰¹å®šç«¯å£å·

**ðŸ”¹ å®žæ—¶æ•°æ®èŽ·å–**
- æ¯æ¬¡è¯·æ±‚éƒ½èŽ·å–æœ€æ–°æ•°æ®
- ä¸å­˜å‚¨åŽ†å²æ•°æ®
- ä¿è¯æ•°æ®çš„å®žæ—¶æ€§å’Œå‡†ç¡®æ€§

---

## 2. âš™ï¸ å·¥ä½œåŽŸç†è¯¦è§£


### 2.1 æ•´ä½“å·¥ä½œæµç¨‹


```
ç›‘æŽ§æµç¨‹å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¢«ç›‘æŽ§ç³»ç»Ÿ  â”‚ â†’ â”‚  Exporter   â”‚ â† â”‚ Prometheus  â”‚
â”‚  (ç›®æ ‡æœåŠ¡)  â”‚    â”‚ (æ•°æ®æ”¶é›†å™¨) â”‚    â”‚  (ç›‘æŽ§æœåŠ¡)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘                    â†‘                    â†‘
   è¿è¡ŒçŠ¶æ€            æ ¼å¼è½¬æ¢              å®šæ—¶æŠ“å–
```

**è¯¦ç»†æ­¥éª¤è§£æž**ï¼š

**â‘  Prometheuså‘èµ·æŠ“å–**
```
# Prometheusé…ç½®ç¤ºä¾‹
scrape_configs:
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:9100']
    scrape_interval: 15s  # æ¯15ç§’æŠ“å–ä¸€æ¬¡
```

**â‘¡ Exporterå“åº”è¯·æ±‚**
- æŽ¥æ”¶åˆ°HTTP GETè¯·æ±‚
- ç«‹å³ä»Žç›®æ ‡ç³»ç»Ÿæ”¶é›†æœ€æ–°æ•°æ®
- å°†æ•°æ®è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
- è¿”å›žHTTPå“åº”

**â‘¢ æ•°æ®æµè½¬è¿‡ç¨‹**
```
åŽŸå§‹æ•°æ®èŽ·å–ï¼š
Linuxç³»ç»Ÿ â†’ è¯»å–/proc/stat â†’ CPUä½¿ç”¨çŽ‡
MySQL â†’ æ‰§è¡ŒSHOW STATUS â†’ è¿žæŽ¥æ•°ç»Ÿè®¡
Redis â†’ æ‰§è¡ŒINFO â†’ å†…å­˜ä½¿ç”¨æƒ…å†µ

æ ¼å¼è½¬æ¢ï¼š
åŽŸå§‹æ•°æ® â†’ è§£æžå¤„ç† â†’ æ ‡å‡†metricsæ ¼å¼
```

### 2.2 HTTPæœåŠ¡å™¨æœºåˆ¶


**ðŸ”¸ åŸºæœ¬æœåŠ¡æž¶æž„**
```python
# ç®€åŒ–çš„Exporterç»“æž„ç¤ºä¾‹
from prometheus_client import start_http_server, Gauge

# åˆ›å»ºæŒ‡æ ‡å¯¹è±¡
cpu_usage = Gauge('cpu_usage_percent', 'CPUä½¿ç”¨ç™¾åˆ†æ¯”')

def collect_metrics():
    # æ”¶é›†ç³»ç»ŸCPUä½¿ç”¨çŽ‡
    usage = get_cpu_usage()  # èŽ·å–å®žé™…CPUæ•°æ®
    cpu_usage.set(usage)     # è®¾ç½®æŒ‡æ ‡å€¼

# å¯åŠ¨HTTPæœåŠ¡å™¨
start_http_server(9100)  # åœ¨9100ç«¯å£æä¾›/metricsæŽ¥å£
```

**ðŸ”¸ è¯·æ±‚å¤„ç†æµç¨‹**
```
å®¢æˆ·ç«¯è¯·æ±‚æµç¨‹ï¼š
1. Prometheus â†’ HTTP GET http://exporter:9100/metrics
2. Exporter â†’ æ”¶é›†å½“å‰ç³»ç»ŸæŒ‡æ ‡
3. Exporter â†’ æ ¼å¼åŒ–ä¸ºmetricsæ ¼å¼
4. Exporter â†’ è¿”å›žHTTP 200 + metricsæ•°æ®
5. Prometheus â†’ è§£æžå¹¶å­˜å‚¨æŒ‡æ ‡æ•°æ®
```

### 2.3 æŒ‡æ ‡æ”¶é›†æµç¨‹


**å®žæ—¶æ”¶é›†ç­–ç•¥**ï¼š
```
æ¯æ¬¡/metricsè¯·æ±‚ â†’ è§¦å‘æ•°æ®æ”¶é›† â†’ è¿”å›žæœ€æ–°æ•°æ®

ä¼˜ç‚¹ï¼šæ•°æ®å®žæ—¶æ€§å¥½
ç¼ºç‚¹ï¼šæ”¶é›†è€—æ—¶å¯èƒ½å½±å“å“åº”é€Ÿåº¦
```

**ç¼“å­˜æ”¶é›†ç­–ç•¥**ï¼š
```
åŽå°å®šæ—¶æ”¶é›† â†’ æ›´æ–°ç¼“å­˜æ•°æ® â†’ /metricsè¿”å›žç¼“å­˜

ä¼˜ç‚¹ï¼šå“åº”é€Ÿåº¦å¿«
ç¼ºç‚¹ï¼šå¯èƒ½å­˜åœ¨æ•°æ®å»¶è¿Ÿ
```

---

## 3. ðŸ”„ Pullæ¨¡å¼vs Pushæ¨¡å¼


### 3.1 Pullæ¨¡å¼è¯¦è§£ï¼ˆPrometheusé»˜è®¤ï¼‰


**ðŸ”¸ å·¥ä½œæœºåˆ¶**
```
Pullæ¨¡å¼ç¤ºæ„å›¾ï¼š
PrometheusæœåŠ¡å™¨                     Exporter
      |                               |
      |-----[1] HTTP GET /metrics---->|
      |                               |
      |<----[2] è¿”å›žmetricsæ•°æ®-------|
      |                               |
   å­˜å‚¨åˆ°TSDB                      ç­‰å¾…ä¸‹æ¬¡è¯·æ±‚
```

**ðŸ”¸ Pullæ¨¡å¼çš„ä¼˜åŠ¿**

**â‘  ç®€åŒ–ç½‘ç»œé…ç½®**
- Exporterä¸éœ€è¦çŸ¥é“Prometheusåœ°å€
- åªéœ€è¦æš´éœ²HTTPç«¯å£å³å¯
- ç½‘ç»œé˜²ç«å¢™é…ç½®ç®€å•

**â‘¡ æ›´å¥½çš„å¯é æ€§**
```
æ•…éšœåœºæ™¯å¯¹æ¯”ï¼š
Prometheusæ•…éšœ â†’ Exporterç»§ç»­è¿è¡Œï¼Œæ¢å¤åŽå¯ç»§ç»­æ”¶é›†
Exporteræ•…éšœ â†’ Prometheusæ£€æµ‹åˆ°æŠ“å–å¤±è´¥ï¼Œè§¦å‘å‘Šè­¦
```

**â‘¢ ä¾¿äºŽè°ƒè¯•æµ‹è¯•**
```bash
# å¯ä»¥ç›´æŽ¥ç”¨æµè§ˆå™¨æˆ–curlæµ‹è¯•
curl http://localhost:9100/metrics

# è¾“å‡ºç¤ºä¾‹
# HELP node_cpu_seconds_total Seconds the CPUs spent in each mode.
# TYPE node_cpu_seconds_total counter
node_cpu_seconds_total{cpu="0",mode="idle"} 12345.67
```

### 3.2 Pushæ¨¡å¼å¯¹æ¯”


**ðŸ”¸ Pushæ¨¡å¼åœºæ™¯**
```
Pushæ¨¡å¼ç¤ºæ„å›¾ï¼š
åº”ç”¨ç¨‹åº/Exporter                  PushGateway
      |                               |
      |-----[1] POST /metrics-------->|
      |                               |
      |<----[2] ç¡®è®¤æŽ¥æ”¶--------------|
      |                               |
                                 ç­‰å¾…PrometheusæŠ“å–
```

**ðŸ”¸ é€‚ç”¨åœºæ™¯**
- **çŸ­æœŸä»»åŠ¡**ï¼šæ‰¹å¤„ç†ä½œä¸šã€å®šæ—¶è„šæœ¬
- **ç½‘ç»œéš”ç¦»**ï¼šæ— æ³•è¢«Prometheusç›´æŽ¥è®¿é—®
- **åŠ¨æ€çŽ¯å¢ƒ**ï¼šå®¹å™¨é¢‘ç¹åˆ›å»ºé”€æ¯

**ðŸ”¸ å®žçŽ°æ–¹å¼**
```python
# Pushæ¨¡å¼ç¤ºä¾‹
from prometheus_client import CollectorRegistry, Gauge, push_to_gateway

# åˆ›å»ºæ³¨å†Œè¡¨å’ŒæŒ‡æ ‡
registry = CollectorRegistry()
batch_duration = Gauge('batch_job_duration_seconds', 
                      'æ‰¹å¤„ç†ä»»åŠ¡æ‰§è¡Œæ—¶é—´', 
                      registry=registry)

# è®°å½•æŒ‡æ ‡å¹¶æŽ¨é€
batch_duration.set(123.45)
push_to_gateway('pushgateway:9091', 
                job='batch_job', 
                registry=registry)
```

### 3.3 æ¨¡å¼é€‰æ‹©æŒ‡å¯¼


| ç‰¹æ€§å¯¹æ¯” | **Pullæ¨¡å¼** | **Pushæ¨¡å¼** |
|---------|-------------|-------------|
| **ç½‘ç»œè¦æ±‚** | `Prometheuså¯è®¿é—®ç›®æ ‡` | `ç›®æ ‡å¯è®¿é—®PushGateway` |
| **é…ç½®å¤æ‚åº¦** | `ç®€å•ï¼Œåªéœ€æš´éœ²ç«¯å£` | `éœ€è¦é…ç½®æŽ¨é€åœ°å€` |
| **æ•…éšœæ¢å¤** | `è‡ªåŠ¨æ¢å¤ï¼Œæ•°æ®ä¸€è‡´` | `å¯èƒ½ä¸¢å¤±æŽ¨é€æœŸé—´æ•°æ®` |
| **è°ƒè¯•ä¾¿åˆ©æ€§** | `ç›´æŽ¥è®¿é—®/metrics` | `éœ€è¦æŸ¥çœ‹PushGateway` |
| **é€‚ç”¨åœºæ™¯** | `é•¿æœŸè¿è¡Œçš„æœåŠ¡` | `çŸ­æœŸä»»åŠ¡ã€æ‰¹å¤„ç†` |

---

## 4. ðŸŒ æŒ‡æ ‡æš´éœ²æœºåˆ¶


### 4.1 /metricsç«¯ç‚¹è¯¦è§£


**ðŸ”¸ æ ‡å‡†ç«¯ç‚¹çº¦å®š**
```
é»˜è®¤è·¯å¾„ï¼šhttp://hostname:port/metrics
æ ‡å‡†ç«¯å£ï¼šå„Exporteræœ‰çº¦å®šç«¯å£å·

å¸¸è§ç«¯å£ç¤ºä¾‹ï¼š
node_exporter: 9100
mysql_exporter: 9104
redis_exporter: 9121
nginx_exporter: 9113
```

**ðŸ”¸ HTTPå“åº”æ ¼å¼**
```http
HTTP/1.1 200 OK
Content-Type: text/plain; version=0.0.4; charset=utf-8
Content-Length: 12345

# HELPæŒ‡æ ‡è¯´æ˜Ž
# TYPEæŒ‡æ ‡ç±»åž‹
æŒ‡æ ‡å{æ ‡ç­¾="å€¼"} æ•°å€¼ æ—¶é—´æˆ³
```

### 4.2 HTTPæœåŠ¡å™¨å®žçŽ°


**ðŸ”¸ ç«¯ç‚¹æ³¨å†Œæœºåˆ¶**
```go
// Goè¯­è¨€å®žçŽ°ç¤ºä¾‹
http.Handle("/metrics", promhttp.Handler())
http.ListenAndServe(":9100", nil)

// è‡ªå®šä¹‰æ”¶é›†å™¨
type MyCollector struct{}

func (c *MyCollector) Collect(ch chan<- prometheus.Metric) {
    // æ”¶é›†æŒ‡æ ‡æ•°æ®
    value := getCurrentValue()
    ch <- prometheus.MustNewConstMetric(
        prometheus.NewDesc("my_metric", "æè¿°", nil, nil),
        prometheus.GaugeValue,
        value,
    )
}
```

**ðŸ”¸ è¯·æ±‚å¤„ç†ç”Ÿå‘½å‘¨æœŸ**
```
è¯·æ±‚å¤„ç†æ­¥éª¤ï¼š
1. æŽ¥æ”¶HTTP GET /metricsè¯·æ±‚
2. è§¦å‘æ‰€æœ‰æ³¨å†Œçš„æ”¶é›†å™¨
3. æ¯ä¸ªæ”¶é›†å™¨æ”¶é›†å½“å‰æ•°æ®
4. æ ¼å¼åŒ–ä¸ºPrometheusæ ¼å¼
5. è¿”å›žHTTPå“åº”
6. è®°å½•è®¿é—®æ—¥å¿—ï¼ˆå¯é€‰ï¼‰
```

### 4.3 å¥åº·æ£€æŸ¥ä¸ŽçŠ¶æ€


**ðŸ”¸ å¥åº·æ£€æŸ¥ç«¯ç‚¹**
```
å¸¸è§å¥åº·æ£€æŸ¥è·¯å¾„ï¼š
/health    - åŸºæœ¬å¥åº·çŠ¶æ€
/ready     - å°±ç»ªçŠ¶æ€æ£€æŸ¥
/-/healthy - Prometheusé£Žæ ¼å¥åº·æ£€æŸ¥

å“åº”ç¤ºä¾‹ï¼š
HTTP 200 OK
{"status": "healthy", "timestamp": "2025-01-15T09:30:00Z"}
```

**ðŸ”¸ çŠ¶æ€ç›‘æŽ§æŒ‡æ ‡**
```python
# å†…ç½®çŠ¶æ€æŒ‡æ ‡ç¤ºä¾‹
from prometheus_client import Info, Counter

# Exporterä¿¡æ¯
exporter_info = Info('exporter_build_info', 'Exporteræž„å»ºä¿¡æ¯')
exporter_info.info({
    'version': '1.0.0',
    'build_date': '2025-01-15',
    'go_version': '1.19'
})

# æŠ“å–ç»Ÿè®¡
scrape_counter = Counter('exporter_scrapes_total', 'æŠ“å–æ¬¡æ•°ç»Ÿè®¡')
```

---

## 5. ðŸ“‹ æ•°æ®æ ¼å¼ä¸Žè§„èŒƒ


### 5.1 Exposition Formatè¯¦è§£


**ðŸ”¸ åŸºæœ¬æ ¼å¼ç»“æž„**
```
# HELP æŒ‡æ ‡åç§° æŒ‡æ ‡æè¿°ä¿¡æ¯
# TYPE æŒ‡æ ‡åç§° æŒ‡æ ‡ç±»åž‹
æŒ‡æ ‡åç§°{æ ‡ç­¾å="æ ‡ç­¾å€¼"} æ•°å€¼ [æ—¶é—´æˆ³]

å®žé™…ç¤ºä¾‹ï¼š
# HELP http_requests_total HTTPè¯·æ±‚æ€»æ•°
# TYPE http_requests_total counter
http_requests_total{method="GET",status="200"} 12345
http_requests_total{method="POST",status="200"} 6789
```

**ðŸ”¸ æ³¨é‡Šè¡Œè§„èŒƒ**
```
HELPè¡Œï¼šæä¾›æŒ‡æ ‡çš„äººç±»å¯è¯»æè¿°
TYPEè¡Œï¼šå£°æ˜ŽæŒ‡æ ‡ç±»åž‹ï¼ˆcounterã€gaugeã€histogramã€summaryï¼‰

æ³¨æ„äº‹é¡¹ï¼š
- HELPå’ŒTYPEå¿…é¡»åœ¨æŒ‡æ ‡æ•°æ®ä¹‹å‰
- æ¯ä¸ªæŒ‡æ ‡åªèƒ½æœ‰ä¸€ä¸ªHELPå’ŒTYPEå£°æ˜Ž
- æè¿°ä¿¡æ¯è¦ç®€æ´æ˜Žäº†ï¼Œä¾¿äºŽç†è§£
```

### 5.2 æŒ‡æ ‡ç±»åž‹æ˜ å°„


**ðŸ”¸ Counterï¼ˆè®¡æ•°å™¨ï¼‰**
```
ç‰¹ç‚¹ï¼šåªèƒ½å¢žåŠ çš„æ•°å€¼
ç”¨é€”ï¼šè¯·æ±‚æ€»æ•°ã€é”™è¯¯æ¬¡æ•°ã€å¤„ç†å­—èŠ‚æ•°

ç¤ºä¾‹ï¼š
# TYPE http_requests_total counter
http_requests_total{path="/api/users"} 1234

å…¸åž‹åº”ç”¨ï¼š
- æŽ¥å£è°ƒç”¨æ¬¡æ•°
- é”™è¯¯å‘ç”Ÿæ¬¡æ•°
- æ•°æ®å¤„ç†é‡
```

**ðŸ”¸ Gaugeï¼ˆä»ªè¡¨ç›˜ï¼‰**
```
ç‰¹ç‚¹ï¼šå¯ä»¥ä»»æ„å¢žå‡çš„æ•°å€¼
ç”¨é€”ï¼šCPUä½¿ç”¨çŽ‡ã€å†…å­˜ä½¿ç”¨é‡ã€è¿žæŽ¥æ•°

ç¤ºä¾‹ï¼š
# TYPE cpu_usage_percent gauge
cpu_usage_percent{cpu="0"} 45.6

å…¸åž‹åº”ç”¨ï¼š
- ç³»ç»Ÿèµ„æºä½¿ç”¨çŽ‡
- å½“å‰è¿žæŽ¥æ•°
- é˜Ÿåˆ—é•¿åº¦
```

**ðŸ”¸ Histogramï¼ˆç›´æ–¹å›¾ï¼‰**
```
ç‰¹ç‚¹ï¼šç»Ÿè®¡æ•°å€¼åˆ†å¸ƒæƒ…å†µ
ç”¨é€”ï¼šè¯·æ±‚å»¶è¿Ÿã€å“åº”å¤§å°åˆ†å¸ƒ

ç¤ºä¾‹ï¼š
# TYPE http_request_duration_seconds histogram
http_request_duration_seconds_bucket{le="0.1"} 100
http_request_duration_seconds_bucket{le="0.5"} 200
http_request_duration_seconds_bucket{le="+Inf"} 250
http_request_duration_seconds_sum 45.6
http_request_duration_seconds_count 250
```

### 5.3 æ ‡ç­¾å¤„ç†æœºåˆ¶


**ðŸ”¸ æ ‡ç­¾å‘½åè§„èŒƒ**
```
æ ‡ç­¾åè§„åˆ™ï¼š
- åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- å¿…é¡»ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´
- ä¸èƒ½ä»¥__å¼€å¤´ï¼ˆç³»ç»Ÿä¿ç•™ï¼‰

å¥½çš„æ ‡ç­¾ç¤ºä¾‹ï¼š
{method="GET", status_code="200", path="/api/users"}

é¿å…çš„æ ‡ç­¾ï¼š
{2xx="true"}           # ä¸èƒ½ä»¥æ•°å­—å¼€å¤´
{__internal="value"}   # ä¸è¦ç”¨åŒä¸‹åˆ’çº¿
```

**ðŸ”¸ æ ‡ç­¾å€¼å¤„ç†**
```python
# æ ‡ç­¾å€¼æ¸…ç†ç¤ºä¾‹
def clean_label_value(value):
    # ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å…è§£æžé”™è¯¯
    return re.sub(r'[^\w\-\.]', '_', str(value))

# ä½¿ç”¨ç¤ºä¾‹
method = clean_label_value(request.method)
gauge.labels(method=method).set(value)
```

---

## 6. ðŸ·ï¸ Exporteråˆ†ç±»


### 6.1 å®˜æ–¹Exporter


**ðŸ”¸ Node Exporter**
```
ä½œç”¨ï¼šç›‘æŽ§Linux/Unixç³»ç»ŸæŒ‡æ ‡
ç«¯å£ï¼š9100
ä¸»è¦æŒ‡æ ‡ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ

å®‰è£…è¿è¡Œï¼š
wget https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz
./node_exporter --web.listen-address=":9100"
```

**ðŸ”¸ Blackbox Exporter**
```
ä½œç”¨ï¼šé»‘ç›’ç›‘æŽ§ï¼Œæ£€æµ‹æœåŠ¡å¯ç”¨æ€§
ç«¯å£ï¼š9115
ä¸»è¦åŠŸèƒ½ï¼šHTTPæ£€æŸ¥ã€TCPæ£€æŸ¥ã€DNSæ£€æŸ¥

é…ç½®ç¤ºä¾‹ï¼š
modules:
  http_2xx:
    prober: http
    http:
      valid_status_codes: [200]
```

### 6.2 ç¬¬ä¸‰æ–¹Exporter


**ðŸ”¸ æ•°æ®åº“ç±»**
```
mysql_exporter (ç«¯å£9104)ï¼š
- ç›‘æŽ§MySQLæ•°æ®åº“æ€§èƒ½
- è¿žæŽ¥æ•°ã€æŸ¥è¯¢ç»Ÿè®¡ã€å¤åˆ¶çŠ¶æ€

redis_exporter (ç«¯å£9121)ï¼š
- ç›‘æŽ§Redisç¼“å­˜æ€§èƒ½
- å†…å­˜ä½¿ç”¨ã€å‘½ä»¤ç»Ÿè®¡ã€é”®ç©ºé—´ä¿¡æ¯

postgres_exporter (ç«¯å£9187)ï¼š
- ç›‘æŽ§PostgreSQLæ•°æ®åº“
- è¿žæŽ¥æ± ã€æŸ¥è¯¢æ€§èƒ½ã€è¡¨ç»Ÿè®¡
```

**ðŸ”¸ åº”ç”¨æœåŠ¡ç±»**
```
nginx_exporter (ç«¯å£9113)ï¼š
- ç›‘æŽ§Nginx WebæœåŠ¡å™¨
- è¯·æ±‚æ•°ã€è¿žæŽ¥æ•°ã€çŠ¶æ€ç ç»Ÿè®¡

elasticsearch_exporter (ç«¯å£9114)ï¼š
- ç›‘æŽ§Elasticsearché›†ç¾¤
- é›†ç¾¤å¥åº·ã€èŠ‚ç‚¹çŠ¶æ€ã€ç´¢å¼•ç»Ÿè®¡
```

### 6.3 è‡ªå®šä¹‰Exporterå¼€å‘


**ðŸ”¸ å¼€å‘åœºæ™¯**
- ç›‘æŽ§ç‰¹å®šä¸šåŠ¡æŒ‡æ ‡
- é›†æˆè‡ªç ”ç³»ç»Ÿ
- ç‰¹æ®Šæ•°æ®æºé€‚é…

**ðŸ”¸ å¼€å‘è¯­è¨€é€‰æ‹©**

| è¯­è¨€ | **ä¼˜åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|------|---------|-------------|
| **Go** | `æ€§èƒ½å¥½ï¼Œå®˜æ–¹æŽ¨è` | `ç³»ç»Ÿçº§ç›‘æŽ§ï¼Œé«˜æ€§èƒ½è¦æ±‚` |
| **Python** | `å¼€å‘ç®€å•ï¼Œåº“ä¸°å¯Œ` | `å¿«é€ŸåŽŸåž‹ï¼Œä¸šåŠ¡ç›‘æŽ§` |
| **Java** | `ä¼ä¸šçº§ï¼ŒSpringé›†æˆ` | `Javaåº”ç”¨ç›‘æŽ§` |
| **Node.js** | `å¼‚æ­¥å¤„ç†ï¼ŒWebå‹å¥½` | `Webåº”ç”¨ï¼ŒAPIç›‘æŽ§` |

---

## 7. âš¡ æ€§èƒ½ä¸Žéƒ¨ç½²è€ƒè™‘


### 7.1 æ€§èƒ½å½±å“åˆ†æž


**ðŸ”¸ æŠ“å–é—´éš”è€ƒè™‘**
```
æŠ“å–é¢‘çŽ‡æƒè¡¡ï¼š
é«˜é¢‘æŠ“å–(5s)ï¼š
âœ… æ•°æ®å®žæ—¶æ€§å¥½
âŒ ç³»ç»Ÿå¼€é”€å¤§ï¼Œå¯èƒ½å½±å“ä¸šåŠ¡

ä½Žé¢‘æŠ“å–(60s)ï¼š
âœ… ç³»ç»Ÿå¼€é”€å°
âŒ å¯èƒ½é”™è¿‡çŸ­æœŸå¼‚å¸¸

æŽ¨èé…ç½®ï¼š
ä¸€èˆ¬æœåŠ¡ï¼š15-30ç§’
å…³é”®æœåŠ¡ï¼š10-15ç§’
ç³»ç»Ÿç›‘æŽ§ï¼š15ç§’
ä¸šåŠ¡ç›‘æŽ§ï¼š30-60ç§’
```

**ðŸ”¸ æŒ‡æ ‡æ•°é‡æŽ§åˆ¶**
```
æŒ‡æ ‡æ•°é‡å»ºè®®ï¼š
å•ä¸ªExporterï¼š< 1000ä¸ªæŒ‡æ ‡
é«˜åŸºæ•°æ ‡ç­¾ï¼šè°¨æ…Žä½¿ç”¨ï¼Œé¿å…æŒ‡æ ‡çˆ†ç‚¸

æŒ‡æ ‡çˆ†ç‚¸ç¤ºä¾‹ï¼ˆé¿å…ï¼‰ï¼š
user_request_count{user_id="12345"}  # å¦‚æžœç”¨æˆ·æ•°ç™¾ä¸‡ï¼ŒæŒ‡æ ‡æ•°çˆ†ç‚¸
user_request_count{user_type="vip"}  # æ›´å¥½çš„æ ‡ç­¾è®¾è®¡
```

### 7.2 é«˜å¯ç”¨éƒ¨ç½²


**ðŸ”¸ éƒ¨ç½²æ¨¡å¼é€‰æ‹©**
```
å•å®žä¾‹éƒ¨ç½²ï¼š
é€‚ç”¨ï¼šæµ‹è¯•çŽ¯å¢ƒã€å°è§„æ¨¡ç›‘æŽ§
é£Žé™©ï¼šå•ç‚¹æ•…éšœ

å¤šå®žä¾‹éƒ¨ç½²ï¼š
é€‚ç”¨ï¼šç”Ÿäº§çŽ¯å¢ƒã€å…³é”®ç›‘æŽ§
å®žçŽ°ï¼šè´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥

å®¹å™¨åŒ–éƒ¨ç½²ï¼š
é€‚ç”¨ï¼šå¾®æœåŠ¡çŽ¯å¢ƒ
ä¼˜åŠ¿ï¼šå¼¹æ€§æ‰©ç¼©å®¹ã€ç‰ˆæœ¬ç®¡ç†
```

**ðŸ”¸ å®¹å™¨éƒ¨ç½²ç¤ºä¾‹**
```yaml
# docker-compose.yml
version: '3.8'
services:
  node-exporter:
    image: prom/node-exporter:v1.5.0
    ports:
      - "9100:9100"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.rootfs=/rootfs'
      - '--path.sysfs=/host/sys'
    restart: unless-stopped
```

### 7.3 ç›‘æŽ§ç›®æ ‡å‘çŽ°


**ðŸ”¸ é™æ€é…ç½®**
```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'node'
    static_configs:
      - targets: 
          - 'server1:9100'
          - 'server2:9100'
          - 'server3:9100'
```

**ðŸ”¸ æœåŠ¡å‘çŽ°**
```yaml
# åŸºäºŽæ–‡ä»¶çš„æœåŠ¡å‘çŽ°
  - job_name: 'file_sd'
    file_sd_configs:
      - files: ['/etc/prometheus/targets/*.json']
        refresh_interval: 30s

# targets.jsonç¤ºä¾‹
[
  {
    "targets": ["192.168.1.10:9100", "192.168.1.11:9100"],
    "labels": {"env": "prod", "team": "backend"}
  }
]
```

---

## 8. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ

```
ðŸ”¸ Exporteræœ¬è´¨ï¼šæ•°æ®æ”¶é›†å™¨å’Œæ ¼å¼è½¬æ¢å™¨
ðŸ”¸ å·¥ä½œæ¨¡å¼ï¼šPullæ¨¡å¼ä¸ºä¸»ï¼Œè¢«åŠ¨å“åº”HTTPè¯·æ±‚
ðŸ”¸ æ ‡å‡†æŽ¥å£ï¼š/metricsç«¯ç‚¹æš´éœ²æ ‡å‡†æ ¼å¼æ•°æ®
ðŸ”¸ æ•°æ®æ ¼å¼ï¼šExposition Formatï¼ŒåŒ…å«HELPã€TYPEã€æŒ‡æ ‡æ•°æ®
ðŸ”¸ æŒ‡æ ‡ç±»åž‹ï¼šCounterã€Gaugeã€Histogramã€Summary
ðŸ”¸ æ ‡ç­¾æœºåˆ¶ï¼šé”®å€¼å¯¹å½¢å¼çš„å…ƒæ•°æ®ï¼Œå¢žå¼ºæŒ‡æ ‡ç»´åº¦
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ ä¸ºä»€ä¹ˆé€‰æ‹©Pullæ¨¡å¼**
```
ç½‘ç»œç®€å•ï¼šExporteråªéœ€æš´éœ²ç«¯å£ï¼Œä¸éœ€è¦çŸ¥é“Prometheusåœ°å€
æ•…éšœéš”ç¦»ï¼šç»„ä»¶æ•…éšœä¸ä¼šç›¸äº’å½±å“
è°ƒè¯•å‹å¥½ï¼šå¯ä»¥ç›´æŽ¥è®¿é—®/metricsæŸ¥çœ‹æ•°æ®
é…ç½®çµæ´»ï¼šPrometheusæŽ§åˆ¶æŠ“å–é¢‘çŽ‡å’Œç›®æ ‡
```

**ðŸ”¹ Exporterçš„æ ¸å¿ƒä»·å€¼**
```
æ•°æ®æ ‡å‡†åŒ–ï¼šç»Ÿä¸€ä¸åŒç³»ç»Ÿçš„æ•°æ®æ ¼å¼
å®žæ—¶æ€§ä¿è¯ï¼šæ¯æ¬¡è¯·æ±‚èŽ·å–æœ€æ–°æ•°æ®
æ‰©å±•æ€§å¥½ï¼šæ”¯æŒè‡ªå®šä¹‰æŒ‡æ ‡å’Œæ ‡ç­¾
ç”Ÿæ€ä¸°å¯Œï¼šè¦†ç›–å„ç§ç³»ç»Ÿå’Œåº”ç”¨
```

**ðŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
åˆç†çš„æŠ“å–é—´éš”ï¼šå¹³è¡¡å®žæ—¶æ€§å’Œæ€§èƒ½å¼€é”€
æŽ§åˆ¶æŒ‡æ ‡æ•°é‡ï¼šé¿å…é«˜åŸºæ•°æ ‡ç­¾å¯¼è‡´æŒ‡æ ‡çˆ†ç‚¸
ä¼˜åŒ–æ”¶é›†é€»è¾‘ï¼šå‡å°‘æ•°æ®æ”¶é›†çš„æ—¶é—´å¼€é”€
é€‚å½“çš„ç¼“å­˜ç­–ç•¥ï¼šæé«˜å“åº”é€Ÿåº¦
```

### 8.3 å®žé™…åº”ç”¨æŒ‡å¯¼


**é€‰æ‹©åˆé€‚çš„Exporter**ï¼š
- âœ… **ç³»ç»Ÿç›‘æŽ§**ï¼šä½¿ç”¨node_exporterç›‘æŽ§æœåŠ¡å™¨
- âœ… **æœåŠ¡ç›‘æŽ§**ï¼šé€‰æ‹©å¯¹åº”çš„ä¸“ç”¨exporter
- âœ… **ä¸šåŠ¡ç›‘æŽ§**ï¼šå¼€å‘è‡ªå®šä¹‰exporter
- âœ… **ç½‘ç»œç›‘æŽ§**ï¼šä½¿ç”¨blackbox_exporter

**éƒ¨ç½²æœ€ä½³å®žè·µ**ï¼š
- **æµ‹è¯•çŽ¯å¢ƒ**ï¼šå•å®žä¾‹éƒ¨ç½²ï¼Œå¿«é€ŸéªŒè¯
- **ç”Ÿäº§çŽ¯å¢ƒ**ï¼šå¤šå®žä¾‹éƒ¨ç½²ï¼Œä¿è¯é«˜å¯ç”¨
- **å®¹å™¨çŽ¯å¢ƒ**ï¼šä½¿ç”¨ç¼–æŽ’å·¥å…·ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
- **ç›‘æŽ§å‘çŽ°**ï¼šç»“åˆæœåŠ¡å‘çŽ°æœºåˆ¶è‡ªåŠ¨åŒ–ç®¡ç†

**æ ¸å¿ƒè®°å¿†**ï¼š
- Exporteræ˜¯Prometheusç”Ÿæ€çš„æ•°æ®å…¥å£
- Pullæ¨¡å¼è®©ç›‘æŽ§æž¶æž„æ›´ç®€å•å¯é 
- æ ‡å‡†åŒ–çš„/metricsæŽ¥å£æ˜¯äº’æ“ä½œçš„åŸºç¡€
- é€‰æ‹©åˆé€‚çš„Exporteræ¯”è‡ªå·±å¼€å‘æ›´é«˜æ•ˆ