---
title: 2ã€åº”ç”¨ç›‘æ§å®è·µ
---
## ğŸ“š ç›®å½•

1. [åº”ç”¨ç›‘æ§åŸºç¡€æ¦‚å¿µ](#1-åº”ç”¨ç›‘æ§åŸºç¡€æ¦‚å¿µ)
2. [åº”ç”¨åŸ‹ç‚¹ç­–ç•¥](#2-åº”ç”¨åŸ‹ç‚¹ç­–ç•¥)
3. [SDKé›†æˆæ–¹æ³•](#3-SDKé›†æˆæ–¹æ³•)
4. [ä¸šåŠ¡æŒ‡æ ‡è®¾è®¡](#4-ä¸šåŠ¡æŒ‡æ ‡è®¾è®¡)
5. [HTTPè¯·æ±‚ç›‘æ§](#5-HTTPè¯·æ±‚ç›‘æ§)
6. [æ•°æ®åº“è¿æ¥æ± ç›‘æ§](#6-æ•°æ®åº“è¿æ¥æ± ç›‘æ§)
7. [æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§](#7-æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§)
8. [å¾®æœåŠ¡é“¾è·¯ç›‘æ§](#8-å¾®æœåŠ¡é“¾è·¯ç›‘æ§)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“Š åº”ç”¨ç›‘æ§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åº”ç”¨ç›‘æ§


**ç®€å•ç†è§£**ï¼šåº”ç”¨ç›‘æ§å°±åƒç»™ä½ çš„ç¨‹åºå®‰è£…"ä½“æ£€ä»ªå™¨"ï¼Œå®æ—¶äº†è§£ç¨‹åºçš„å¥åº·çŠ¶å†µã€‚

```
å°±åƒåŒ»ç”Ÿç»™ç—…äººä½“æ£€ï¼š
ä½“æ¸© â†’ åº”ç”¨çš„CPUä½¿ç”¨ç‡
è¡€å‹ â†’ åº”ç”¨çš„å†…å­˜ä½¿ç”¨æƒ…å†µ  
å¿ƒè·³ â†’ åº”ç”¨çš„å“åº”æ—¶é—´
è¡€æ£€ â†’ åº”ç”¨çš„é”™è¯¯ç‡ç»Ÿè®¡

åŒ»ç”Ÿé€šè¿‡è¿™äº›æŒ‡æ ‡åˆ¤æ–­ç—…äººå¥åº·çŠ¶å†µ
è¿ç»´é€šè¿‡ç›‘æ§æŒ‡æ ‡åˆ¤æ–­åº”ç”¨è¿è¡ŒçŠ¶å†µ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åº”ç”¨ç›‘æ§


**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸ” **åŠæ—¶å‘ç°é—®é¢˜** - åœ¨ç”¨æˆ·æŠ•è¯‰å‰å‘ç°æ•…éšœ
- ğŸ“ˆ **æ€§èƒ½ä¼˜åŒ–æŒ‡å¯¼** - æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆåœ¨å“ªé‡Œ
- ğŸ“Š **ä¸šåŠ¡æ•°æ®æ´å¯Ÿ** - äº†è§£ç”¨æˆ·è¡Œä¸ºå’Œä¸šåŠ¡è¶‹åŠ¿
- ğŸš¨ **æ•…éšœå¿«é€Ÿå®šä½** - ç¼©çŸ­é—®é¢˜æ’æŸ¥æ—¶é—´

### 1.3 åº”ç”¨ç›‘æ§çš„å±‚æ¬¡


**ç›‘æ§é‡‘å­—å¡”æ¨¡å‹**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ä¸šåŠ¡ç›‘æ§å±‚                â”‚ â† è®¢å•é‡ã€æ”¯ä»˜æˆåŠŸç‡ã€ç”¨æˆ·æ´»è·ƒåº¦
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    åº”ç”¨ç›‘æ§å±‚                â”‚ â† æ¥å£å“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€QPS
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ä¸­é—´ä»¶ç›‘æ§å±‚              â”‚ â† æ•°æ®åº“ã€Redisã€MQæ€§èƒ½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    åŸºç¡€è®¾æ–½ç›‘æ§å±‚            â”‚ â† CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ¯ åº”ç”¨åŸ‹ç‚¹ç­–ç•¥


### 2.1 åŸ‹ç‚¹æ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šåŸ‹ç‚¹å°±åƒåœ¨å…³é”®è·¯å£å®‰è£…æ‘„åƒå¤´ï¼Œè®°å½•é‡è¦äº‹ä»¶çš„å‘ç”Ÿã€‚

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
å•†åœºåŸ‹ç‚¹ â†’ å„æ¥¼å±‚è¿›å‡ºäººæ•°ç»Ÿè®¡
ç½‘ç«™åŸ‹ç‚¹ â†’ é¡µé¢è®¿é—®ã€æŒ‰é’®ç‚¹å‡»ç»Ÿè®¡
åº”ç”¨åŸ‹ç‚¹ â†’ æ¥å£è°ƒç”¨ã€ä¸šåŠ¡æ“ä½œç»Ÿè®¡
```

### 2.2 åŸ‹ç‚¹ç­–ç•¥è®¾è®¡


#### ğŸ”¸ å…¨é‡åŸ‹ç‚¹ vs é‡‡æ ·åŸ‹ç‚¹


**å…¨é‡åŸ‹ç‚¹**ï¼šè®°å½•æ‰€æœ‰äº‹ä»¶
```
ä¼˜ç‚¹ï¼šæ•°æ®å®Œæ•´ï¼Œä¸ä¸¢å¤±ä¿¡æ¯
ç¼ºç‚¹ï¼šå­˜å‚¨æˆæœ¬é«˜ï¼Œå¯èƒ½å½±å“æ€§èƒ½
é€‚ç”¨ï¼šæ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼Œä½é¢‘æ“ä½œ
```

**é‡‡æ ·åŸ‹ç‚¹**ï¼šæŒ‰æ¯”ä¾‹è®°å½•äº‹ä»¶  
```
ä¼˜ç‚¹ï¼šé™ä½å­˜å‚¨æˆæœ¬ï¼Œå‡å°‘æ€§èƒ½å½±å“
ç¼ºç‚¹ï¼šæ•°æ®ä¸å®Œæ•´ï¼Œéœ€è¦ç»Ÿè®¡æ¨ç®—
é€‚ç”¨ï¼šé«˜é¢‘æ“ä½œï¼Œéæ ¸å¿ƒæµç¨‹
```

#### ğŸ”¸ åŸ‹ç‚¹ä½ç½®é€‰æ‹©


**å…³é”®åŸ‹ç‚¹ä½ç½®**ï¼š
- **æ¥å£å…¥å£/å‡ºå£** - ç›‘æ§è¯·æ±‚æµé‡å’Œå“åº”æƒ…å†µ
- **ä¸šåŠ¡æ“ä½œèŠ‚ç‚¹** - è®°å½•æ ¸å¿ƒä¸šåŠ¡äº‹ä»¶
- **å¼‚å¸¸å¤„ç†ç‚¹** - æ•è·é”™è¯¯å’Œå¼‚å¸¸ä¿¡æ¯
- **å¤–éƒ¨ä¾èµ–è°ƒç”¨** - ç›‘æ§ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨

### 2.3 åŸ‹ç‚¹æœ€ä½³å®è·µ


**æ ¸å¿ƒåŸåˆ™**ï¼š
```
ğŸ¯ ç›®æ ‡æ˜ç¡®ï¼šæ¯ä¸ªåŸ‹ç‚¹éƒ½è¦æœ‰æ˜ç¡®çš„ç›‘æ§ç›®æ ‡
ğŸ“Š æŒ‡æ ‡æ ‡å‡†ï¼šä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒå’Œæ ‡ç­¾
âš¡ æ€§èƒ½å‹å¥½ï¼šåŸ‹ç‚¹ä¸èƒ½æ˜¾è‘—å½±å“åº”ç”¨æ€§èƒ½
ğŸ”§ æ˜“äºç»´æŠ¤ï¼šåŸ‹ç‚¹ä»£ç è¦ç®€æ´ã€å¯ç»´æŠ¤
```

---

## 3. ğŸ› ï¸ SDKé›†æˆæ–¹æ³•


### 3.1 Javaåº”ç”¨é›†æˆ


#### ğŸ”¸ æ·»åŠ ä¾èµ–


```xml
<dependency>
    <groupId>io.prometheus</groupId>
    <artifactId>simpleclient</artifactId>
    <version>0.16.0</version>
</dependency>
<dependency>
    <groupId>io.prometheus</groupId>
    <artifactId>simpleclient_httpserver</artifactId>
    <version>0.16.0</version>
</dependency>
```

#### ğŸ”¸ åŸºç¡€é…ç½®


```java
// åˆ›å»ºæŒ‡æ ‡æ³¨å†Œå™¨
CollectorRegistry registry = new CollectorRegistry();

// å¯åŠ¨HTTPæœåŠ¡å™¨æš´éœ²æŒ‡æ ‡
HTTPServer server = new HTTPServer(8080);
```

### 3.2 Spring Booté›†æˆ


**æ·»åŠ Starterä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

**é…ç½®æ–‡ä»¶**ï¼š
```yaml
management:
  endpoints:
    web:
      exposure:
        include: prometheus,health,info
  endpoint:
    prometheus:
      enabled: true
```

### 3.3 Pythonåº”ç”¨é›†æˆ


```python
from prometheus_client import Counter, Histogram, start_http_server

# å¯åŠ¨æŒ‡æ ‡æœåŠ¡å™¨
start_http_server(8000)

# åˆ›å»ºæŒ‡æ ‡
REQUEST_COUNT = Counter('app_requests_total', 'Total requests')
REQUEST_DURATION = Histogram('app_request_duration_seconds', 'Request duration')
```

---

## 4. ğŸ“ˆ ä¸šåŠ¡æŒ‡æ ‡è®¾è®¡


### 4.1 ä¸šåŠ¡æŒ‡æ ‡åˆ†ç±»


#### ğŸ”¸ æµé‡æŒ‡æ ‡ï¼ˆTrafficï¼‰

```
ä½œç”¨ï¼šè¡¡é‡ä¸šåŠ¡æ´»è·ƒåº¦
ä¾‹å­ï¼š
- æ¯ç§’è¯·æ±‚æ•°ï¼ˆQPSï¼‰
- é¡µé¢æµè§ˆé‡ï¼ˆPVï¼‰
- ç”¨æˆ·è®¿é—®é‡ï¼ˆUVï¼‰
- è®¢å•åˆ›å»ºæ•°é‡
```

#### ğŸ”¸ æˆåŠŸç‡æŒ‡æ ‡ï¼ˆSuccess Rateï¼‰

```
ä½œç”¨ï¼šè¡¡é‡ä¸šåŠ¡è´¨é‡
ä¾‹å­ï¼š
- æ¥å£æˆåŠŸç‡
- æ”¯ä»˜æˆåŠŸç‡  
- ç™»å½•æˆåŠŸç‡
- è®¢å•å®Œæˆç‡
```

#### ğŸ”¸ æ€§èƒ½æŒ‡æ ‡ï¼ˆPerformanceï¼‰

```
ä½œç”¨ï¼šè¡¡é‡ç”¨æˆ·ä½“éªŒ
ä¾‹å­ï¼š
- æ¥å£å“åº”æ—¶é—´
- é¡µé¢åŠ è½½æ—¶é—´
- æ•°æ®åº“æŸ¥è¯¢è€—æ—¶
- ç¼“å­˜å‘½ä¸­ç‡
```

### 4.2 æŒ‡æ ‡å‘½åè§„èŒƒ


**å‘½åæ ¼å¼**ï¼š`{åº”ç”¨å}_{æŒ‡æ ‡ç±»å‹}_{å•ä½}`

```
å¥½çš„å‘½åç¤ºä¾‹ï¼š
- user_login_requests_totalï¼ˆç”¨æˆ·ç™»å½•è¯·æ±‚æ€»æ•°ï¼‰
- order_payment_duration_secondsï¼ˆè®¢å•æ”¯ä»˜è€—æ—¶ï¼‰
- product_search_errors_totalï¼ˆå•†å“æœç´¢é”™è¯¯æ€»æ•°ï¼‰

é¿å…çš„å‘½åï¼š
- countï¼ˆå¤ªæ¨¡ç³Šï¼‰
- timeï¼ˆæ²¡æœ‰è¯´æ˜ä»€ä¹ˆæ—¶é—´ï¼‰
- errorï¼ˆæ²¡æœ‰è¯´æ˜ä»€ä¹ˆé”™è¯¯ï¼‰
```

### 4.3 æ ‡ç­¾è®¾è®¡ç­–ç•¥


**æ ‡ç­¾ä½¿ç”¨åŸåˆ™**ï¼š
```
âœ… åˆç†æ ‡ç­¾ï¼š
- methodï¼ˆGETã€POSTã€PUTï¼‰
- statusï¼ˆ200ã€404ã€500ï¼‰
- regionï¼ˆcn-northã€cn-southï¼‰

âŒ é¿å…çš„æ ‡ç­¾ï¼š
- user_idï¼ˆå€¼å¤ªå¤šï¼Œå¯¼è‡´æŒ‡æ ‡çˆ†ç‚¸ï¼‰
- request_idï¼ˆæ¯æ¬¡éƒ½ä¸åŒï¼‰
- timestampï¼ˆæ—¶é—´æˆ³å˜åŒ–å¤ªå¿«ï¼‰
```

---

## 5. ğŸŒ HTTPè¯·æ±‚ç›‘æ§


### 5.1 HTTPç›‘æ§æŒ‡æ ‡


#### ğŸ”¸ æ ¸å¿ƒç›‘æ§ç»´åº¦


**è¯·æ±‚é‡æŒ‡æ ‡**ï¼š
```java
// è¯·æ±‚æ€»æ•°è®¡æ•°å™¨
private static final Counter HTTP_REQUESTS_TOTAL = Counter.build()
    .name("http_requests_total")
    .help("Total HTTP requests")
    .labelNames("method", "endpoint", "status")
    .register();
```

**å“åº”æ—¶é—´æŒ‡æ ‡**ï¼š
```java
// å“åº”æ—¶é—´ç›´æ–¹å›¾
private static final Histogram HTTP_REQUEST_DURATION = Histogram.build()
    .name("http_request_duration_seconds")
    .help("HTTP request duration")
    .labelNames("method", "endpoint")
    .register();
```

### 5.2 å®é™…ç›‘æ§å®ç°


#### ğŸ”¸ ä½¿ç”¨è¿‡æ»¤å™¨ç›‘æ§


```java
@Component
public class PrometheusFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // è®°å½•å¼€å§‹æ—¶é—´
        Timer.Sample sample = Timer.start();
        
        try {
            // æ‰§è¡Œè¯·æ±‚
            chain.doFilter(request, response);
        } finally {
            // è®°å½•æŒ‡æ ‡
            String method = httpRequest.getMethod();
            String endpoint = httpRequest.getRequestURI();
            String status = String.valueOf(httpResponse.getStatus());
            
            // æ›´æ–°è®¡æ•°å™¨
            HTTP_REQUESTS_TOTAL.labels(method, endpoint, status).inc();
            
            // è®°å½•å“åº”æ—¶é—´
            sample.stop(HTTP_REQUEST_DURATION.labels(method, endpoint));
        }
    }
}
```

### 5.3 ç›‘æ§æ•°æ®ç¤ºä¾‹


**æŒ‡æ ‡æ•°æ®è¾“å‡º**ï¼š
```
# è¯·æ±‚æ€»æ•°
http_requests_total{method="GET",endpoint="/api/users",status="200"} 1500
http_requests_total{method="POST",endpoint="/api/orders",status="201"} 300
http_requests_total{method="GET",endpoint="/api/products",status="500"} 5

# å“åº”æ—¶é—´åˆ†å¸ƒ
http_request_duration_seconds_bucket{method="GET",endpoint="/api/users",le="0.1"} 1200
http_request_duration_seconds_bucket{method="GET",endpoint="/api/users",le="0.5"} 1450
http_request_duration_seconds_bucket{method="GET",endpoint="/api/users",le="1.0"} 1500
```

---

## 6. ğŸ—„ï¸ æ•°æ®åº“è¿æ¥æ± ç›‘æ§


### 6.1 ä¸ºä»€ä¹ˆè¦ç›‘æ§è¿æ¥æ± 


**è¿æ¥æ± çš„ä½œç”¨**ï¼š
```
æ²¡æœ‰è¿æ¥æ± çš„æƒ…å†µï¼š
å®¢æˆ·ç«¯è¯·æ±‚ â†’ åˆ›å»ºæ•°æ®åº“è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å…³é—­è¿æ¥
æ¯æ¬¡éƒ½è¦å»ºç«‹å’Œå…³é—­è¿æ¥ï¼Œæ€§èƒ½å·®

æœ‰è¿æ¥æ± çš„æƒ…å†µï¼š  
å®¢æˆ·ç«¯è¯·æ±‚ â†’ ä»æ± ä¸­è·å–è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å½’è¿˜è¿æ¥
è¿æ¥é‡å¤ä½¿ç”¨ï¼Œæ€§èƒ½å¥½
```

**ç›‘æ§çš„å¿…è¦æ€§**ï¼š
- ğŸ” **è¿æ¥æ³„éœ²æ£€æµ‹** - å‘ç°æ²¡æœ‰æ­£ç¡®å½’è¿˜çš„è¿æ¥
- ğŸ“Š **æ€§èƒ½ç“¶é¢ˆè¯†åˆ«** - è¿æ¥ä¸å¤Ÿç”¨æ—¶ä¼šæ’é˜Ÿç­‰å¾…
- âš¡ **å®¹é‡è§„åˆ’æŒ‡å¯¼** - äº†è§£å®é™…éœ€è¦å¤šå°‘è¿æ¥

### 6.2 å…³é”®ç›‘æ§æŒ‡æ ‡


#### ğŸ”¸ è¿æ¥æ± çŠ¶æ€æŒ‡æ ‡


```java
// æ´»è·ƒè¿æ¥æ•°
Gauge.build()
    .name("db_pool_active_connections")
    .help("Active database connections")
    .register();

// ç©ºé—²è¿æ¥æ•°  
Gauge.build()
    .name("db_pool_idle_connections")
    .help("Idle database connections")
    .register();

// ç­‰å¾…è¿æ¥çš„è¯·æ±‚æ•°
Gauge.build()
    .name("db_pool_pending_requests")
    .help("Pending connection requests")
    .register();
```

### 6.3 HikariCPç›‘æ§é›†æˆ


**HikariCPé…ç½®**ï¼š
```yaml
spring:
  datasource:
    hikari:
      pool-name: MyHikariCP
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      metric-registry: prometheusRegistry
```

**ç›‘æ§æŒ‡æ ‡è·å–**ï¼š
```java
@Component
public class DatabasePoolMetrics {
    
    @Autowired
    private HikariDataSource dataSource;
    
    @EventListener(ApplicationReadyEvent.class)
    public void setupMetrics() {
        HikariPoolMXBean poolBean = dataSource.getHikariPoolMXBean();
        
        // æ³¨å†Œè¿æ¥æ± æŒ‡æ ‡
        Gauge.build()
            .name("db_pool_active_connections")
            .help("Active connections")
            .setAsynchronousProducer(() -> poolBean.getActiveConnections())
            .register();
            
        Gauge.build()
            .name("db_pool_total_connections")
            .help("Total connections")
            .setAsynchronousProducer(() -> poolBean.getTotalConnections())
            .register();
    }
}
```

---

## 7. ğŸ“¨ æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§


### 7.1 æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§é‡è¦æ€§


**æ¶ˆæ¯é˜Ÿåˆ—çš„ç‰¹ç‚¹**ï¼š
```
å¼‚æ­¥å¤„ç†ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…å¼‚æ­¥å¤„ç†
è§£è€¦ç³»ç»Ÿï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
æµé‡å‰Šå³°ï¼šé«˜å³°æœŸæ¶ˆæ¯æ’é˜Ÿï¼Œå¹³ç¨³å¤„ç†

ç›‘æ§éš¾ç‚¹ï¼š
- æ¶ˆæ¯å¯èƒ½ç§¯å‹
- æ¶ˆè´¹è€…å¯èƒ½å¤„ç†å¤±è´¥
- ç½‘ç»œé—®é¢˜å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±
```

### 7.2 RabbitMQç›‘æ§


#### ğŸ”¸ æ ¸å¿ƒç›‘æ§æŒ‡æ ‡


```java
// æ¶ˆæ¯å‘é€æ€»æ•°
private static final Counter MESSAGES_SENT = Counter.build()
    .name("mq_messages_sent_total")
    .help("Total sent messages")
    .labelNames("queue", "exchange")
    .register();

// æ¶ˆæ¯æ¶ˆè´¹æ€»æ•°
private static final Counter MESSAGES_CONSUMED = Counter.build()
    .name("mq_messages_consumed_total")
    .help("Total consumed messages")
    .labelNames("queue")
    .register();

// é˜Ÿåˆ—é•¿åº¦
private static final Gauge QUEUE_SIZE = Gauge.build()
    .name("mq_queue_size")
    .help("Messages in queue")
    .labelNames("queue")
    .register();
```

#### ğŸ”¸ ç”Ÿäº§è€…ç›‘æ§


```java
@Service
public class MessageProducer {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void sendMessage(String exchange, String routingKey, Object message) {
        Timer.Sample sample = Timer.start();
        
        try {
            rabbitTemplate.convertAndSend(exchange, routingKey, message);
            
            // è®°å½•æˆåŠŸå‘é€
            MESSAGES_SENT.labels(routingKey, exchange).inc();
            
        } catch (Exception e) {
            // è®°å½•å‘é€å¤±è´¥
            MESSAGES_SENT.labels(routingKey, exchange + "_error").inc();
            throw e;
        } finally {
            // è®°å½•å‘é€è€—æ—¶
            sample.stop(Timer.builder("mq_send_duration")
                .tag("exchange", exchange)
                .register(Metrics.globalRegistry));
        }
    }
}
```

### 7.3 Kafkaç›‘æ§


**Kafkaç”Ÿäº§è€…ç›‘æ§**ï¼š
```java
// Kafkaç”Ÿäº§è€…é…ç½®
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("metric.reporters", "io.prometheus.client.kafka.KafkaPrometheusMetricsReporter");

// åˆ›å»ºç”Ÿäº§è€…
KafkaProducer<String, String> producer = new KafkaProducer<>(props);
```

**æ¶ˆè´¹è€…lagç›‘æ§**ï¼š
```java
// æ¶ˆè´¹è€…å»¶è¿ŸæŒ‡æ ‡
Gauge.build()
    .name("kafka_consumer_lag")
    .help("Consumer lag per partition")
    .labelNames("topic", "partition", "consumer_group")
    .register();
```

---

## 8. ğŸ”— å¾®æœåŠ¡é“¾è·¯ç›‘æ§


### 8.1 å¾®æœåŠ¡ç›‘æ§æŒ‘æˆ˜


**å¾®æœåŠ¡çš„å¤æ‚æ€§**ï¼š
```
å•ä½“åº”ç”¨è°ƒç”¨é“¾è·¯ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨æœåŠ¡ â†’ æ•°æ®åº“ â†’ è¿”å›ç»“æœ

å¾®æœåŠ¡è°ƒç”¨é“¾è·¯ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ç½‘å…³ â†’ ç”¨æˆ·æœåŠ¡ â†’ è®¢å•æœåŠ¡ â†’ æ”¯ä»˜æœåŠ¡ â†’ åº“å­˜æœåŠ¡ â†’ æ•°æ®åº“
                    â†“           â†“           â†“
                  ç¼“å­˜       æ¶ˆæ¯é˜Ÿåˆ—      ç¬¬ä¸‰æ–¹API

é—®é¢˜ï¼š
- è°ƒç”¨é“¾è·¯é•¿ï¼Œä»»ä½•ä¸€ç¯å‡ºé—®é¢˜éƒ½å½±å“æ•´ä½“
- éš¾ä»¥å®šä½æ€§èƒ½ç“¶é¢ˆåœ¨å“ªä¸ªæœåŠ¡
- æœåŠ¡é—´ä¾èµ–å…³ç³»å¤æ‚
```

### 8.2 åˆ†å¸ƒå¼è¿½è¸ªæ¦‚å¿µ


**Trace IDçš„ä½œç”¨**ï¼š
```
ä¸€æ¬¡ç”¨æˆ·è¯·æ±‚çš„å®Œæ•´é“¾è·¯ï¼š

TraceID: abc123
â”œâ”€ SpanID: span1 [APIç½‘å…³] 
â”œâ”€ SpanID: span2 [ç”¨æˆ·æœåŠ¡] (parent: span1)
â”œâ”€ SpanID: span3 [è®¢å•æœåŠ¡] (parent: span1)  
â”œâ”€ SpanID: span4 [æ”¯ä»˜æœåŠ¡] (parent: span3)
â””â”€ SpanID: span5 [æ•°æ®åº“æŸ¥è¯¢] (parent: span4)

é€šè¿‡TraceIDå¯ä»¥ä¸²è”æ•´ä¸ªè°ƒç”¨é“¾è·¯
é€šè¿‡SpanIDå¯ä»¥å®šä½å…·ä½“çš„æœåŠ¡è°ƒç”¨
```

### 8.3 OpenTracingé›†æˆ


#### ğŸ”¸ æ·»åŠ ä¾èµ–


```xml
<dependency>
    <groupId>io.opentracing</groupId>
    <artifactId>opentracing-api</artifactId>
</dependency>
<dependency>
    <groupId>io.jaegertracing</groupId>
    <artifactId>jaeger-client</artifactId>
</dependency>
```

#### ğŸ”¸ åŸºç¡€è¿½è¸ªå®ç°


```java
@RestController
public class UserController {
    
    @Autowired
    private Tracer tracer;
    
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {
        // åˆ›å»ºSpan
        Span span = tracer.nextSpan()
            .name("get-user")
            .tag("user.id", id.toString())
            .start();
        
        try (Tracer.SpanInScope ws = tracer.withSpanInScope(span)) {
            // ä¸šåŠ¡é€»è¾‘
            User user = userService.findById(id);
            
            // æ·»åŠ é¢å¤–æ ‡ç­¾
            span.tag("user.found", user != null);
            
            return user;
        } catch (Exception e) {
            // è®°å½•é”™è¯¯
            span.tag("error", true);
            span.tag("error.message", e.getMessage());
            throw e;
        } finally {
            span.end();
        }
    }
}
```

### 8.4 æœåŠ¡é—´è°ƒç”¨ç›‘æ§


**HTTPè°ƒç”¨ç›‘æ§**ï¼š
```java
@Component
public class TracedRestTemplate {
    
    private final RestTemplate restTemplate;
    private final Tracer tracer;
    
    public <T> T getForObject(String url, Class<T> responseType) {
        Span span = tracer.nextSpan()
            .name("http-call")
            .tag("http.url", url)
            .tag("http.method", "GET")
            .start();
            
        try (Tracer.SpanInScope ws = tracer.withSpanInScope(span)) {
            return restTemplate.getForObject(url, responseType);
        } catch (Exception e) {
            span.tag("error", true);
            throw e;
        } finally {
            span.end();
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åº”ç”¨ç›‘æ§æœ¬è´¨ï¼šç»™ç¨‹åºå®‰è£…"å¥åº·æ£€æŸ¥å™¨"
ğŸ”¸ åŸ‹ç‚¹ç­–ç•¥ï¼šåœ¨å…³é”®ä½ç½®è®°å½•é‡è¦äº‹ä»¶
ğŸ”¸ SDKé›†æˆï¼šè®©åº”ç”¨å…·å¤‡æŒ‡æ ‡æš´éœ²èƒ½åŠ›
ğŸ”¸ ä¸šåŠ¡æŒ‡æ ‡ï¼šè¡¡é‡ä¸šåŠ¡å¥åº·åº¦çš„å…³é”®æ•°æ®
ğŸ”¸ HTTPç›‘æ§ï¼šç›‘æ§æ¥å£æ€§èƒ½å’ŒæˆåŠŸç‡  
ğŸ”¸ è¿æ¥æ± ç›‘æ§ï¼šç›‘æ§æ•°æ®åº“è¿æ¥ä½¿ç”¨æƒ…å†µ
ğŸ”¸ æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§ï¼šç›‘æ§å¼‚æ­¥å¤„ç†æ€§èƒ½
ğŸ”¸ é“¾è·¯ç›‘æ§ï¼šè¿½è¸ªå¾®æœåŠ¡è°ƒç”¨å…¨è¿‡ç¨‹
```

### 9.2 å®è·µè¦ç‚¹


**ğŸ”¹ ç›‘æ§æŒ‡æ ‡è®¾è®¡åŸåˆ™**
```
æœ‰ç›®çš„ï¼šæ¯ä¸ªæŒ‡æ ‡éƒ½è¦æœ‰æ˜ç¡®çš„ç›‘æ§ç›®æ ‡
æœ‰æ ‡å‡†ï¼šä½¿ç”¨ç»Ÿä¸€çš„å‘½åå’Œæ ‡ç­¾è§„èŒƒ
æœ‰å±‚æ¬¡ï¼šä»åŸºç¡€è®¾æ–½åˆ°ä¸šåŠ¡çš„å®Œæ•´ç›‘æ§
æœ‰è¾¹ç•Œï¼šé¿å…è¿‡åº¦ç›‘æ§å½±å“æ€§èƒ½
```

**ğŸ”¹ åŸ‹ç‚¹å®æ–½ç­–ç•¥**
```
æ¸è¿›å¼ï¼šä»æ ¸å¿ƒåŠŸèƒ½å¼€å§‹ï¼Œé€æ­¥å®Œå–„
æ ‡å‡†åŒ–ï¼šåˆ¶å®šå›¢é˜Ÿç»Ÿä¸€çš„åŸ‹ç‚¹è§„èŒƒ
è‡ªåŠ¨åŒ–ï¼šå°½é‡ä½¿ç”¨æ¡†æ¶è‡ªåŠ¨åŸ‹ç‚¹
å¯è§‚æµ‹ï¼šåŸ‹ç‚¹æœ¬èº«ä¹Ÿè¦å¯ç›‘æ§
```

**ğŸ”¹ ç›‘æ§å‘Šè­¦è®¾ç½®**
```
åˆ†çº§å‘Šè­¦ï¼šç´§æ€¥ã€é‡è¦ã€ä¸€èˆ¬ä¸‰ä¸ªçº§åˆ«
é˜ˆå€¼åˆç†ï¼šåŸºäºå†å²æ•°æ®è®¾ç½®åˆç†é˜ˆå€¼
å‡å°‘å™ªéŸ³ï¼šé¿å…é¢‘ç¹çš„æ— æ•ˆå‘Šè­¦
å¿«é€Ÿå“åº”ï¼šå»ºç«‹å‘Šè­¦å¤„ç†æµç¨‹
```

### 9.3 å¸¸è§é—®é¢˜ä¸è§£å†³


**ğŸ”¸ æ€§èƒ½å½±å“é—®é¢˜**
- **é—®é¢˜**ï¼šç›‘æ§ä»£ç å½±å“åº”ç”¨æ€§èƒ½
- **è§£å†³**ï¼šä½¿ç”¨å¼‚æ­¥ä¸ŠæŠ¥ã€é‡‡æ ·ç‡æ§åˆ¶ã€æŒ‡æ ‡èšåˆ

**ğŸ”¸ æŒ‡æ ‡çˆ†ç‚¸é—®é¢˜**
- **é—®é¢˜**ï¼šæ ‡ç­¾å€¼è¿‡å¤šå¯¼è‡´å­˜å‚¨å‹åŠ›å¤§
- **è§£å†³**ï¼šé™åˆ¶æ ‡ç­¾åŸºæ•°ã€åˆå¹¶ç›¸ä¼¼æ ‡ç­¾

**ğŸ”¸ ç›‘æ§ç›²åŒºé—®é¢˜**
- **é—®é¢˜**ï¼šé‡è¦ä¸šåŠ¡æµç¨‹æ²¡æœ‰ç›‘æ§è¦†ç›–
- **è§£å†³**ï¼šæ¢³ç†å…³é”®ä¸šåŠ¡è·¯å¾„ã€è¡¥å……ç›‘æ§åŸ‹ç‚¹

### 9.4 æœ€ä½³å®è·µæ€»ç»“


**ç›‘æ§ä½“ç³»å»ºè®¾è·¯å¾„**ï¼š
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç›‘æ§
- ç³»ç»Ÿèµ„æºç›‘æ§ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- åº”ç”¨å­˜æ´»ç›‘æ§ï¼ˆå¥åº·æ£€æŸ¥ï¼‰
- æ ¸å¿ƒæ¥å£ç›‘æ§ï¼ˆQPSã€å“åº”æ—¶é—´ï¼‰

ç¬¬äºŒé˜¶æ®µï¼šä¸šåŠ¡ç›‘æ§  
- å…³é”®ä¸šåŠ¡æµç¨‹ç›‘æ§
- ç”¨æˆ·è¡Œä¸ºç›‘æ§
- ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡

ç¬¬ä¸‰é˜¶æ®µï¼šæ™ºèƒ½ç›‘æ§
- å¼‚å¸¸æ£€æµ‹ç®—æ³•
- é¢„æµ‹æ€§ç›‘æ§
- è‡ªåŠ¨åŒ–è¿ç»´
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- åº”ç”¨ç›‘æ§æ˜¯ä¿éšœç³»ç»Ÿç¨³å®šè¿è¡Œçš„é‡è¦æ‰‹æ®µ
- åˆç†çš„åŸ‹ç‚¹ç­–ç•¥æ˜¯ç›‘æ§æˆåŠŸçš„åŸºç¡€
- æŒ‡æ ‡è®¾è®¡è¦å¹³è¡¡å®Œæ•´æ€§å’Œæ€§èƒ½
- å¾®æœåŠ¡ç›‘æ§éœ€è¦åˆ†å¸ƒå¼è¿½è¸ªæ”¯æŒ
- ç›‘æ§ä½“ç³»å»ºè®¾æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹