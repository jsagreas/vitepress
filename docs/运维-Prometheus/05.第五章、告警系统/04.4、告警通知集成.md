---
title: 4ã€å‘Šè­¦é€šçŸ¥é›†æˆ
---
## ğŸ“š ç›®å½•


1. [å‘Šè­¦é€šçŸ¥ç³»ç»Ÿæ¦‚è¿°](#1-å‘Šè­¦é€šçŸ¥ç³»ç»Ÿæ¦‚è¿°)
2. [é‚®ä»¶é€šçŸ¥é…ç½®](#2-é‚®ä»¶é€šçŸ¥é…ç½®)
3. [Webhookè‡ªå®šä¹‰é€šçŸ¥](#3-Webhookè‡ªå®šä¹‰é€šçŸ¥)
4. [ä¼ä¸šå¾®ä¿¡é›†æˆ](#4-ä¼ä¸šå¾®ä¿¡é›†æˆ)
5. [é’‰é’‰æœºå™¨äººé…ç½®](#5-é’‰é’‰æœºå™¨äººé…ç½®)
6. [Slacké€šçŸ¥è®¾ç½®](#6-Slacké€šçŸ¥è®¾ç½®)
7. [çŸ­ä¿¡å‘Šè­¦é›†æˆ](#7-çŸ­ä¿¡å‘Šè­¦é›†æˆ)
8. [å‘Šè­¦æ¨¡æ¿å®šåˆ¶](#8-å‘Šè­¦æ¨¡æ¿å®šåˆ¶)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”” å‘Šè­¦é€šçŸ¥ç³»ç»Ÿæ¦‚è¿°



### 1.1 ä»€ä¹ˆæ˜¯å‘Šè­¦é€šçŸ¥



ğŸ“ **éš¾åº¦ç­‰çº§**ï¼šğŸŸ¢ åŸºç¡€

**ç®€å•ç†è§£**ï¼šå‘Šè­¦é€šçŸ¥å°±åƒå®¶é‡Œçš„çƒŸé›¾æŠ¥è­¦å™¨ï¼Œå½“æ£€æµ‹åˆ°å¼‚å¸¸æ—¶ä¼šå‘å‡ºè­¦æŠ¥ã€‚Prometheusçš„å‘Šè­¦é€šçŸ¥ç³»ç»Ÿä¹Ÿæ˜¯ä¸€æ ·ï¼Œå½“ç›‘æ§æŒ‡æ ‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šè‡ªåŠ¨é€šè¿‡å„ç§æ–¹å¼ï¼ˆé‚®ä»¶ã€å¾®ä¿¡ã€é’‰é’‰ç­‰ï¼‰é€šçŸ¥ç›¸å…³äººå‘˜ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
çƒŸé›¾æŠ¥è­¦å™¨ â†’ æ£€æµ‹åˆ°çƒŸé›¾ â†’ å‘å‡ºè­¦æŠ¥å£° â†’ é€šçŸ¥ä½æˆ·
Prometheus â†’ æ£€æµ‹åˆ°å¼‚å¸¸ â†’ è§¦å‘å‘Šè­¦ â†’ å‘é€é€šçŸ¥æ¶ˆæ¯
```

### 1.2 å‘Šè­¦é€šçŸ¥çš„å·¥ä½œæµç¨‹



ğŸ”„ **å®Œæ•´æµç¨‹å›¾**ï¼š
```
ç›‘æ§æŒ‡æ ‡æ•°æ® â†’ Prometheusé‡‡é›† â†’ å‘Šè­¦è§„åˆ™è¯„ä¼° â†’ Alertmanagerå¤„ç† â†’ é€šçŸ¥æ¸ é“å‘é€
      â†‘                â†‘              â†‘              â†‘            â†‘
   ä¸šåŠ¡ç³»ç»Ÿ        å®šæ—¶é‡‡é›†        è§„åˆ™åŒ¹é…      è·¯ç”±åˆ†ç»„     é‚®ä»¶/å¾®ä¿¡/é’‰é’‰
```

**ğŸ¯ æ ¸å¿ƒç»„ä»¶è¯´æ˜**ï¼š
- **Prometheus**ï¼šè´Ÿè´£é‡‡é›†æ•°æ®å’Œè¯„ä¼°å‘Šè­¦è§„åˆ™
- **Alertmanager**ï¼šä¸“é—¨å¤„ç†å‘Šè­¦é€šçŸ¥çš„ç»„ä»¶
- **é€šçŸ¥æ¸ é“**ï¼šå…·ä½“å‘é€æ¶ˆæ¯çš„æ–¹å¼ï¼ˆé‚®ä»¶ã€å¾®ä¿¡ç­‰ï¼‰

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦å¤šç§é€šçŸ¥æ–¹å¼



ğŸ’¼ **å®é™…åº”ç”¨åœºæ™¯**ï¼š
> ğŸ¢ **å·¥ä½œæ—¶é—´**ï¼šé€šè¿‡é‚®ä»¶ã€ä¼ä¸šå¾®ä¿¡é€šçŸ¥ï¼Œæ–¹ä¾¿æŸ¥çœ‹è¯¦æƒ…
> ğŸŒ™ **éå·¥ä½œæ—¶é—´**ï¼šé€šè¿‡çŸ­ä¿¡ã€ç”µè¯é€šçŸ¥ï¼Œç¡®ä¿åŠæ—¶å“åº”
> ğŸš¨ **ç´§æ€¥æ•…éšœ**ï¼šå¤šæ¸ é“åŒæ—¶é€šçŸ¥ï¼Œé¿å…é—æ¼

---

## 2. ğŸ“§ é‚®ä»¶é€šçŸ¥é…ç½®



### 2.1 é‚®ä»¶é€šçŸ¥åŸºæœ¬æ¦‚å¿µ



**ä»€ä¹ˆæ˜¯é‚®ä»¶é€šçŸ¥ï¼Ÿ**
é‚®ä»¶é€šçŸ¥æ˜¯æœ€ä¼ ç»Ÿä¹Ÿæ˜¯æœ€ç¨³å®šçš„å‘Šè­¦æ–¹å¼ï¼Œå°±åƒç»™ä½ å‘ä¸€å°"ç³»ç»Ÿå‡ºé—®é¢˜äº†"çš„é‚®ä»¶ï¼ŒåŒ…å«è¯¦ç»†çš„æ•…éšœä¿¡æ¯ã€‚

### 2.2 SMTPé…ç½®è¯¦è§£



ğŸ“Š **SMTPé…ç½®å‚æ•°è¯´æ˜**ï¼š

| å‚æ•°åç§° | ä½œç”¨è¯´æ˜ | ç¤ºä¾‹å€¼ |
|----------|----------|--------|
| `smtp_smarthost` | ğŸ“® é‚®ä»¶æœåŠ¡å™¨åœ°å€ | smtp.qq.com:587 |
| `smtp_from` | ğŸ“§ å‘ä»¶äººé‚®ç®± | alert@company.com |
| `smtp_auth_username` | ğŸ‘¤ ç™»å½•ç”¨æˆ·å | alert@company.com |
| `smtp_auth_password` | ğŸ” ç™»å½•å¯†ç  | åº”ç”¨ä¸“ç”¨å¯†ç  |

**åŸºç¡€é‚®ä»¶é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# alertmanager.yml é‚®ä»¶é…ç½®

global:
#  # SMTPæœåŠ¡å™¨é…ç½®
  smtp_smarthost: 'smtp.qq.com:587'
  smtp_from: 'prometheus-alert@company.com'
  smtp_auth_username: 'prometheus-alert@company.com'
  smtp_auth_password: 'your-app-password'
  smtp_require_tls: true

route:
#  # é»˜è®¤æ¥æ”¶è€…
  receiver: 'email-alerts'

receivers:
- name: 'email-alerts'
  email_configs:
  - to: 'admin@company.com'
    subject: 'ğŸš¨ ç³»ç»Ÿå‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
    body: |
      å‘Šè­¦è¯¦æƒ…ï¼š
      - å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}
      - è§¦å‘æ—¶é—´ï¼š{{ .CommonAnnotations.summary }}
      - è¯¦ç»†ä¿¡æ¯ï¼š{{ .CommonAnnotations.description }}
```

### 2.3 é‚®ä»¶æ¨¡æ¿ä¼˜åŒ–



ğŸ¨ **ç¾åŒ–çš„é‚®ä»¶æ¨¡æ¿**ï¼š
```yaml
receivers:
- name: 'email-alerts'
  email_configs:
  - to: 'ops-team@company.com'
    subject: '[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }}'
    html: |
      <!DOCTYPE html>
      <html>
      <head>
        <style>
          .alert-critical { color: #d32f2f; }
          .alert-warning { color: #f57c00; }
          .alert-info { color: #1976d2; }
        </style>
      </head>
      <body>
        <h2 class="alert-critical">ğŸš¨ ç³»ç»Ÿå‘Šè­¦é€šçŸ¥</h2>
        <table border="1" style="border-collapse: collapse;">
          <tr>
            <td><strong>å‘Šè­¦åç§°</strong></td>
            <td>{{ .GroupLabels.alertname }}</td>
          </tr>
          <tr>
            <td><strong>å‘Šè­¦çº§åˆ«</strong></td>
            <td>{{ .CommonLabels.severity }}</td>
          </tr>
          <tr>
            <td><strong>æœåŠ¡å®ä¾‹</strong></td>
            <td>{{ .CommonLabels.instance }}</td>
          </tr>
          <tr>
            <td><strong>è§¦å‘æ—¶é—´</strong></td>
            <td>{{ .CommonAnnotations.summary }}</td>
          </tr>
        </table>
        <p><strong>å¤„ç†å»ºè®®ï¼š</strong>{{ .CommonAnnotations.description }}</p>
      </body>
      </html>
```

ğŸ’¡ **é‚®ä»¶é…ç½®æŠ€å·§**ï¼š
- **ä¸»é¢˜è¦é†’ç›®**ï¼šä½¿ç”¨emojiå’ŒçŠ¶æ€æ ‡è¯†ï¼Œä¸€çœ¼çœ‹å‡ºä¸¥é‡ç¨‹åº¦
- **å†…å®¹è¦è¯¦ç»†**ï¼šåŒ…å«è¶³å¤Ÿä¿¡æ¯è®©æ¥æ”¶è€…å¿«é€Ÿå®šä½é—®é¢˜
- **æ ¼å¼è¦ç¾è§‚**ï¼šä½¿ç”¨HTMLæ ¼å¼ï¼Œè¡¨æ ¼å±•ç¤ºæ›´æ¸…æ™°

---

## 3. ğŸ”— Webhookè‡ªå®šä¹‰é€šçŸ¥



### 3.1 Webhooké€šçŸ¥åŸç†



**ä»€ä¹ˆæ˜¯Webhookï¼Ÿ**
Webhookå°±åƒæ˜¯ä¸€ä¸ª"ä¿¡ä½¿"ï¼Œå½“å‘Šè­¦è§¦å‘æ—¶ï¼ŒAlertmanagerä¼šä¸»åŠ¨å‘é€HTTPè¯·æ±‚åˆ°ä½ æŒ‡å®šçš„ç½‘å€ï¼Œæºå¸¦å‘Šè­¦è¯¦æƒ…ã€‚è¿™æ ·ä½ å¯ä»¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚

```
ä¼ ç»Ÿæ¨¡å¼ï¼šä½ ä¸»åŠ¨é—®"æœ‰æ²¡æœ‰å‘Šè­¦ï¼Ÿ"ï¼ˆè½®è¯¢ï¼‰
Webhookï¼šç³»ç»Ÿä¸»åŠ¨å‘Šè¯‰ä½ "å‡ºé—®é¢˜äº†ï¼"ï¼ˆæ¨é€ï¼‰
```

### 3.2 Webhooké…ç½®ç¤ºä¾‹



```yaml
# alertmanager.yml webhooké…ç½®

receivers:
- name: 'webhook-alerts'
  webhook_configs:
  - url: 'http://your-server:8080/webhook/alerts'
#    # å‘é€è¶…æ—¶æ—¶é—´
    send_resolved: true
#    # æ˜¯å¦å‘é€å·²è§£å†³çš„å‘Šè­¦
    http_config:
      basic_auth:
        username: 'webhook-user'
        password: 'webhook-pass'
```

### 3.3 è‡ªå®šä¹‰Webhookå¤„ç†ç¨‹åº



**ç®€å•çš„Webhookæ¥æ”¶å™¨ç¤ºä¾‹**ï¼š
```python
# webhook_receiver.py

from flask import Flask, request, jsonify
import json

app = Flask(__name__)

@app.route('/webhook/alerts', methods=['POST'])
def receive_alert():
    """æ¥æ”¶Prometheuså‘Šè­¦"""
    try:
#        # è·å–å‘Šè­¦æ•°æ®
        alert_data = request.json
        
#        # éå†æ‰€æœ‰å‘Šè­¦
        for alert in alert_data.get('alerts', []):
            alert_name = alert['labels'].get('alertname', 'æœªçŸ¥å‘Šè­¦')
            instance = alert['labels'].get('instance', 'æœªçŸ¥å®ä¾‹')
            status = alert['status']
            
            print(f"æ”¶åˆ°å‘Šè­¦: {alert_name} - {instance} - {status}")
            
#            # è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰å¤„ç†é€»è¾‘
#            # æ¯”å¦‚ï¼šå†™å…¥æ•°æ®åº“ã€è°ƒç”¨å…¶ä»–APIã€å‘é€è‡ªå®šä¹‰é€šçŸ¥ç­‰
            
        return jsonify({"status": "success"})
    
    except Exception as e:
        print(f"å¤„ç†å‘Šè­¦å¤±è´¥: {e}")
        return jsonify({"status": "error"}), 500

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

ğŸ”— **å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦åŸºæœ¬äº†è§£HTTPåè®®å’ŒPythonç¼–ç¨‹

---

## 4. ğŸ¢ ä¼ä¸šå¾®ä¿¡é›†æˆ



### 4.1 ä¼ä¸šå¾®ä¿¡å‘Šè­¦çš„ä¼˜åŠ¿



**ä¸ºä»€ä¹ˆé€‰æ‹©ä¼ä¸šå¾®ä¿¡ï¼Ÿ**
- âœ… **å³æ—¶æ€§å¼º**ï¼šæ‰‹æœºç«¯å®æ—¶æ¨é€ï¼Œæ¯”é‚®ä»¶æ›´åŠæ—¶
- âœ… **ä½¿ç”¨ä¾¿æ·**ï¼šä¼ä¸šå†…éƒ¨éƒ½åœ¨ç”¨ï¼Œæ— éœ€é¢å¤–å®‰è£…
- âœ… **æ”¯æŒå¯Œæ–‡æœ¬**ï¼šå¯ä»¥å‘é€å¡ç‰‡ã€å›¾ç‰‡ç­‰ä¸°å¯Œå†…å®¹

### 4.2 ä¼ä¸šå¾®ä¿¡æœºå™¨äººé…ç½®æ­¥éª¤



ğŸ”„ **é…ç½®æµç¨‹**ï¼š
**Step 1** ğŸ¤– åˆ›å»ºä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äºº
  â†“
**Step 2** ğŸ“ è·å–Webhookåœ°å€  
  â†“
**Step 3** âš™ï¸ é…ç½®Alertmanager
  â†“
**Step 4** âœ… æµ‹è¯•å‘Šè­¦å‘é€

### 4.3 ä¼ä¸šå¾®ä¿¡é…ç½®å®ä¾‹



```yaml
# alertmanager.yml ä¼ä¸šå¾®ä¿¡é…ç½®

receivers:
- name: 'wechat-ops'
  webhook_configs:
  - url: 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_BOT_KEY'
    send_resolved: true
    http_config:
      proxy_url: 'http://proxy-server:8080'  # å¦‚æœéœ€è¦ä»£ç†
```

**ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯æ ¼å¼åŒ–è„šæœ¬**ï¼š
```python
# wechat_formatter.py

import requests
import json

def send_wechat_alert(webhook_url, alert_data):
    """å‘é€æ ¼å¼åŒ–çš„ä¼ä¸šå¾®ä¿¡å‘Šè­¦"""
    
#    # æ„é€ æ¶ˆæ¯å†…å®¹
    message = {
        "msgtype": "markdown",
        "markdown": {
            "content": f"""
# ğŸš¨ ç³»ç»Ÿå‘Šè­¦é€šçŸ¥



**å‘Šè­¦åç§°**: {alert_data['alertname']}
**å‘Šè­¦çº§åˆ«**: <font color="warning">{alert_data['severity']}</font>
**å½±å“å®ä¾‹**: {alert_data['instance']}
**å‘Šè­¦æè¿°**: {alert_data['description']}

> è¯·ç›¸å…³åŒäº‹åŠæ—¶å¤„ç†ï¼
            """
        }
    }
    
    response = requests.post(webhook_url, json=message)
    return response.status_code == 200
```

ğŸ’¡ **ä¼ä¸šå¾®ä¿¡ä½¿ç”¨æŠ€å·§**ï¼š
- **Markdownæ ¼å¼**ï¼šä½¿ç”¨markdownè®©æ¶ˆæ¯æ›´ç¾è§‚
- **@ç›¸å…³äººå‘˜**ï¼šåœ¨é‡è¦å‘Šè­¦ä¸­@å¯¹åº”è´Ÿè´£äºº
- **åˆ†ç¾¤ç®¡ç†**ï¼šä¸åŒç±»å‹å‘Šè­¦å‘é€åˆ°ä¸åŒç¾¤ç»„

---

## 5. ğŸ“± é’‰é’‰æœºå™¨äººé…ç½®



### 5.1 é’‰é’‰æœºå™¨äººç‰¹ç‚¹



**é’‰é’‰vsä¼ä¸šå¾®ä¿¡å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | é’‰é’‰ | ä¼ä¸šå¾®ä¿¡ |
|------|------|----------|
| ğŸ” å®‰å…¨æ€§ | æ”¯æŒç­¾åéªŒè¯ | åŸºäºIPç™½åå• |
| ğŸ“Š æ¶ˆæ¯æ ¼å¼ | æ”¯æŒActionCard | æ”¯æŒå°ç¨‹åºå¡ç‰‡ |
| ğŸš€ å‘é€é¢‘ç‡ | 20æ¡/åˆ†é’Ÿ | æ— æ˜ç¡®é™åˆ¶ |
| ğŸ‘¥ ä½¿ç”¨åœºæ™¯ | ä¸­å°ä¼ä¸šå¸¸ç”¨ | å¤§ä¼ä¸šå¸¸ç”¨ |

### 5.2 é’‰é’‰æœºå™¨äººé…ç½®



```yaml
# alertmanager.yml é’‰é’‰é…ç½®

receivers:
- name: 'dingtalk-ops'
  webhook_configs:
  - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_ACCESS_TOKEN'
    send_resolved: true
```

**é’‰é’‰æ¶ˆæ¯å‘é€è„šæœ¬**ï¼š
```python
# dingtalk_sender.py

import hmac
import hashlib
import base64
import urllib.parse
import time
import requests

def generate_sign(secret, timestamp):
    """ç”Ÿæˆé’‰é’‰ç­¾å"""
    string_to_sign = f'{timestamp}\n{secret}'
    hmac_code = hmac.new(
        secret.encode('utf-8'),
        string_to_sign.encode('utf-8'),
        hashlib.sha256
    ).digest()
    sign = urllib.parse.quote_plus(base64.b64encode(hmac_code))
    return sign

def send_dingtalk_alert(access_token, secret, alert_info):
    """å‘é€é’‰é’‰å‘Šè­¦æ¶ˆæ¯"""
    timestamp = str(round(time.time() * 1000))
    sign = generate_sign(secret, timestamp)
    
    webhook_url = f"https://oapi.dingtalk.com/robot/send?access_token={access_token}&timestamp={timestamp}&sign={sign}"
    
    message = {
        "msgtype": "actionCard",
        "actionCard": {
            "title": f"ğŸš¨ {alert_info['alertname']} å‘Šè­¦",
            "text": f"""
## ç³»ç»Ÿå‘Šè­¦è¯¦æƒ…


- **å‘Šè­¦åç§°**: {alert_info['alertname']}
- **å‘Šè­¦çº§åˆ«**: {alert_info['severity']}
- **é—®é¢˜å®ä¾‹**: {alert_info['instance']}
- **è¯¦ç»†æè¿°**: {alert_info['description']}

![screenshot](https://your-grafana.com/dashboard.png)
            """,
            "btnOrientation": "0",
            "singleTitle": "æŸ¥çœ‹Grafana",
            "singleURL": "https://your-grafana.com/dashboard"
        }
    }
    
    response = requests.post(webhook_url, json=message)
    return response.json()
```

---

## 6. ğŸ’¬ Slacké€šçŸ¥è®¾ç½®



### 6.1 Slacké›†æˆçš„ä»·å€¼



**ä¸ºä»€ä¹ˆå›½å¤–å…¬å¸çˆ±ç”¨Slackï¼Ÿ**
- ğŸŒ **å›½é™…åŒ–**ï¼šæ”¯æŒå¤šæ—¶åŒºã€å¤šè¯­è¨€å›¢é˜Ÿåä½œ
- ğŸ”§ **é›†æˆä¸°å¯Œ**ï¼šå¯ä»¥é›†æˆå¤§é‡ç¬¬ä¸‰æ–¹å·¥å…·
- ğŸ“Š **å·¥ä½œæµè‡ªåŠ¨åŒ–**ï¼šæ”¯æŒå¤æ‚çš„è‡ªåŠ¨åŒ–æµç¨‹

### 6.2 Slacké…ç½®ç¤ºä¾‹



```yaml
# alertmanager.yml Slacké…ç½®

global:
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

receivers:
- name: 'slack-alerts'
  slack_configs:
  - channel: '#ops-alerts'
    username: 'Prometheus'
    icon_emoji: ':warning:'
    title: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
    text: |
      {{ range .Alerts }}
      *Alert:* {{ .Annotations.summary }}
      *Description:* {{ .Annotations.description }}
      *Instance:* {{ .Labels.instance }}
      *Severity:* {{ .Labels.severity }}
      {{ end }}
#    # å‘Šè­¦è§£å†³æ—¶çš„æ¶ˆæ¯
    send_resolved: true
    title_link: 'https://your-grafana.com/dashboard'
```

**é«˜çº§Slacké…ç½®**ï¼š
```yaml
slack_configs:
- channel: '#critical-alerts'
  color: '{{ if eq .Status "firing" }}danger{{ else }}good{{ end }}'
  fields:
  - title: 'å‘Šè­¦å®ä¾‹'
    value: '{{ .CommonLabels.instance }}'
    short: true
  - title: 'å‘Šè­¦çº§åˆ«'
    value: '{{ .CommonLabels.severity }}'
    short: true
  actions:
  - type: button
    text: 'æŸ¥çœ‹Grafana'
    url: 'https://your-grafana.com/dashboard'
  - type: button
    text: 'æŸ¥çœ‹æ—¥å¿—'
    url: 'https://your-logs.com/search'
```

---

## 7. ğŸ“² çŸ­ä¿¡å‘Šè­¦é›†æˆ



### 7.1 çŸ­ä¿¡å‘Šè­¦çš„å¿…è¦æ€§



**ä»€ä¹ˆæ—¶å€™éœ€è¦çŸ­ä¿¡å‘Šè­¦ï¼Ÿ**
- ğŸš¨ **ä¸¥é‡æ•…éšœ**ï¼šå½±å“ä¸šåŠ¡çš„P0çº§åˆ«æ•…éšœ
- ğŸŒ™ **éå·¥ä½œæ—¶é—´**ï¼šç¡®ä¿å€¼ç­äººå‘˜èƒ½åŠæ—¶å“åº”
- ğŸ”„ **å¤šé‡ä¿éšœ**ï¼šå…¶ä»–é€šçŸ¥æ–¹å¼å¤±æ•ˆæ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

### 7.2 çŸ­ä¿¡æœåŠ¡æä¾›å•†é€‰æ‹©



ğŸ“Š **å¸¸ç”¨çŸ­ä¿¡æœåŠ¡å¯¹æ¯”**ï¼š

| æœåŠ¡å•† | ğŸ’° ä»·æ ¼ | ğŸš€ é€Ÿåº¦ | ğŸ“ˆ åˆ°è¾¾ç‡ | ğŸŒ è¦†ç›– |
|--------|---------|---------|-----------|---------|
| é˜¿é‡Œäº‘çŸ­ä¿¡ | 0.045å…ƒ/æ¡ | ç§’çº§ | >99% | å›½å†…å¤– |
| è…¾è®¯äº‘çŸ­ä¿¡ | 0.05å…ƒ/æ¡ | ç§’çº§ | >99% | å›½å†…å¤– |
| åä¸ºäº‘çŸ­ä¿¡ | 0.04å…ƒ/æ¡ | ç§’çº§ | >98% | å›½å†…å¤– |

### 7.3 çŸ­ä¿¡å‘Šè­¦å®ç°



**åŸºäºé˜¿é‡Œäº‘çŸ­ä¿¡çš„å®ç°**ï¼š
```python
# sms_sender.py

from aliyunsdkcore.client import AcsClient
from aliyunsdkcore.request import CommonRequest
import json

class SMSAlertSender:
    def __init__(self, access_key_id, access_key_secret, sign_name, template_code):
        self.client = AcsClient(access_key_id, access_key_secret, 'cn-hangzhou')
        self.sign_name = sign_name
        self.template_code = template_code
    
    def send_alert_sms(self, phone_numbers, alert_data):
        """å‘é€å‘Šè­¦çŸ­ä¿¡"""
        request = CommonRequest()
        request.set_accept_format('json')
        request.set_domain('dysmsapi.aliyuncs.com')
        request.set_method('POST')
        request.set_version('2017-05-25')
        request.set_action_name('SendSms')
        
#        # çŸ­ä¿¡å‚æ•°
        template_param = {
            "alertname": alert_data['alertname'][:10],  # é™åˆ¶é•¿åº¦
            "instance": alert_data['instance'][:20],
            "severity": alert_data['severity']
        }
        
        request.add_query_param('PhoneNumbers', ','.join(phone_numbers))
        request.add_query_param('SignName', self.sign_name)
        request.add_query_param('TemplateCode', self.template_code)
        request.add_query_param('TemplateParam', json.dumps(template_param))
        
        response = self.client.do_action(request)
        return json.loads(response)

# ä½¿ç”¨ç¤ºä¾‹

sms_sender = SMSAlertSender(
    access_key_id='your-access-key',
    access_key_secret='your-secret',
    sign_name='ç›‘æ§å‘Šè­¦',
    template_code='SMS_123456789'
)

# å‘é€çŸ­ä¿¡

result = sms_sender.send_alert_sms(
    phone_numbers=['13800138000', '13900139000'],
    alert_data={
        'alertname': 'CPUä½¿ç”¨ç‡è¿‡é«˜',
        'instance': 'web-server-01',
        'severity': 'ä¸¥é‡'
    }
)
```

ğŸ”— **ç›¸å…³æ¦‚å¿µ**ï¼šéœ€è¦äº†è§£çŸ­ä¿¡æ¨¡æ¿ã€ç­¾åç­‰æ¦‚å¿µ

---

## 8. ğŸ¨ å‘Šè­¦æ¨¡æ¿å®šåˆ¶



### 8.1 æ¨¡æ¿è¯­æ³•åŸºç¡€



**Goæ¨¡æ¿è¯­æ³•ç®€ä»‹**ï¼š
Alertmanagerä½¿ç”¨Goè¯­è¨€çš„templateåŒ…ï¼Œæ”¯æŒå˜é‡ã€å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ç­‰åŠŸèƒ½ã€‚

```
åŸºæœ¬è¯­æ³•ï¼š
{{ .CommonLabels.alertname }}     # è·å–å‘Šè­¦åç§°
{{ range .Alerts }}...{{ end }}   # å¾ªç¯éå†å‘Šè­¦
{{ if eq .Status "firing" }}...{{ end }}  # æ¡ä»¶åˆ¤æ–­
```

### 8.2 å¯ç”¨çš„æ¨¡æ¿å˜é‡



ğŸ“š **æ ¸å¿ƒæ¨¡æ¿å˜é‡è¯´æ˜**ï¼š

| å˜é‡å | å«ä¹‰ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `.Status` | å‘Šè­¦çŠ¶æ€ | firing/resolved |
| `.GroupLabels` | åˆ†ç»„æ ‡ç­¾ | {alertname: "HighCPU"} |
| `.CommonLabels` | å…¬å…±æ ‡ç­¾ | {instance: "web-01"} |
| `.CommonAnnotations` | å…¬å…±æ³¨è§£ | {summary: "CPUè¿‡é«˜"} |
| `.Alerts` | å‘Šè­¦åˆ—è¡¨ | åŒ…å«æ‰€æœ‰å‘Šè­¦è¯¦æƒ… |

### 8.3 å®ç”¨æ¨¡æ¿ç¤ºä¾‹



**å¤šåŠŸèƒ½å‘Šè­¦æ¨¡æ¿**ï¼š
```yaml
# é€šç”¨å‘Šè­¦æ¨¡æ¿

templates:
- '/etc/alertmanager/templates/*.tmpl'

receivers:
- name: 'multi-format-alerts'
  email_configs:
  - to: 'ops@company.com'
    subject: |
      {{ if eq .Status "firing" }}ğŸš¨ [ALERT]{{ else }}âœ… [RESOLVED]{{ end }} 
      {{ .GroupLabels.alertname }} - {{ .Alerts | len }} alerts
    
    html: |
      <!DOCTYPE html>
      <html>
      <head>
        <style>
          .status-firing { background: #ffebee; border-left: 4px solid #f44336; }
          .status-resolved { background: #e8f5e8; border-left: 4px solid #4caf50; }
          .alert-box { margin: 10px 0; padding: 15px; }
          table { border-collapse: collapse; width: 100%; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          th { background-color: #f2f2f2; }
        </style>
      </head>
      <body>
        <h2>{{ if eq .Status "firing" }}ğŸš¨ æ´»è·ƒå‘Šè­¦{{ else }}âœ… å·²è§£å†³å‘Šè­¦{{ end }}</h2>
        
        {{ range .Alerts }}
        <div class="alert-box {{ if eq .Status "firing" }}status-firing{{ else }}status-resolved{{ end }}">
          <h3>{{ .Labels.alertname }}</h3>
          <table>
            <tr><th>å±æ€§</th><th>å€¼</th></tr>
            <tr><td>çŠ¶æ€</td><td>{{ .Status }}</td></tr>
            <tr><td>å®ä¾‹</td><td>{{ .Labels.instance }}</td></tr>
            <tr><td>çº§åˆ«</td><td>{{ .Labels.severity }}</td></tr>
            <tr><td>æè¿°</td><td>{{ .Annotations.description }}</td></tr>
            <tr><td>å¼€å§‹æ—¶é—´</td><td>{{ .StartsAt.Format "2006-01-02 15:04:05" }}</td></tr>
            {{ if .EndsAt }}
            <tr><td>ç»“æŸæ—¶é—´</td><td>{{ .EndsAt.Format "2006-01-02 15:04:05" }}</td></tr>
            {{ end }}
          </table>
        </div>
        {{ end }}
        
        <hr>
        <p><small>å‘Šè­¦æ—¶é—´: {{ .CommonAnnotations.summary }}</small></p>
      </body>
      </html>
```

### 8.4 æ¨¡æ¿æœ€ä½³å®è·µ



ğŸ’¡ **æ¨¡æ¿è®¾è®¡æŠ€å·§**ï¼š
- **ä¿¡æ¯åˆ†å±‚**ï¼šé‡è¦ä¿¡æ¯çªå‡ºæ˜¾ç¤ºï¼Œæ¬¡è¦ä¿¡æ¯æŠ˜å æˆ–ç½®å
- **çŠ¶æ€åŒºåˆ†**ï¼šä¸åŒçŠ¶æ€ä½¿ç”¨ä¸åŒé¢œè‰²å’Œå›¾æ ‡
- **é“¾æ¥é›†æˆ**ï¼šåŒ…å«è·³è½¬åˆ°ç›‘æ§é¢æ¿çš„é“¾æ¥
- **ç§»åŠ¨å‹å¥½**ï¼šè€ƒè™‘æ‰‹æœºç«¯æŸ¥çœ‹ä½“éªŒ

**æ¨¡æ¿è°ƒè¯•æ–¹æ³•**ï¼š
```bash
# ä½¿ç”¨amtoolæµ‹è¯•æ¨¡æ¿

amtool template test \
  --template.file=/path/to/template.tmpl \
  --template.data=/path/to/test-data.json
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ å‘Šè­¦é€šçŸ¥æµç¨‹ï¼šæ•°æ®é‡‡é›† â†’ è§„åˆ™è¯„ä¼° â†’ å‘Šè­¦å¤„ç† â†’ é€šçŸ¥å‘é€
ğŸ”¸ Alertmanagerä½œç”¨ï¼šä¸“é—¨è´Ÿè´£å‘Šè­¦çš„è·¯ç”±ã€åˆ†ç»„ã€æŠ‘åˆ¶å’Œé€šçŸ¥
ğŸ”¸ å¤šæ¸ é“ç­–ç•¥ï¼šä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒé€šçŸ¥æ–¹å¼ï¼Œç¡®ä¿å‘Šè­¦ä¸é—æ¼
ğŸ”¸ æ¨¡æ¿å®šåˆ¶ï¼šä½¿ç”¨Goæ¨¡æ¿è¯­æ³•è‡ªå®šä¹‰å‘Šè­¦æ¶ˆæ¯æ ¼å¼
ğŸ”¸ é›†æˆæ–¹å¼ï¼šæ”¯æŒé‚®ä»¶ã€Webhookã€ä¼ä¸šIMç­‰å¤šç§é›†æˆæ–¹å¼
```

### 9.2 å®é™…åº”ç”¨æŒ‡å¯¼



ğŸ¯ **é€šçŸ¥æ¸ é“é€‰æ‹©ç­–ç•¥**ï¼š
```
é‚®ä»¶é€šçŸ¥ï¼š
âœ… é€‚åˆï¼šè¯¦ç»†ä¿¡æ¯å±•ç¤ºã€éç´§æ€¥å‘Šè­¦ã€å­˜æ¡£è®°å½•
âŒ ä¸é€‚åˆï¼šéœ€è¦å³æ—¶å“åº”çš„ç´§æ€¥æƒ…å†µ

å³æ—¶é€šè®¯ï¼ˆå¾®ä¿¡/é’‰é’‰ï¼‰ï¼š
âœ… é€‚åˆï¼šå·¥ä½œæ—¶é—´ã€å›¢é˜Ÿåä½œã€å¿«é€Ÿå“åº”
âŒ ä¸é€‚åˆï¼šéå·¥ä½œæ—¶é—´ã€ä¸ªäººå•ç‹¬å¤„ç†

çŸ­ä¿¡é€šçŸ¥ï¼š
âœ… é€‚åˆï¼šä¸¥é‡æ•…éšœã€éå·¥ä½œæ—¶é—´ã€æœ€åå…œåº•
âŒ ä¸é€‚åˆï¼šé¢‘ç¹å‘Šè­¦ã€è¯¦ç»†ä¿¡æ¯å±•ç¤º

Webhookï¼š
âœ… é€‚åˆï¼šè‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€ç³»ç»Ÿé›†æˆã€è‡ªåŠ¨åŒ–å“åº”
âŒ ä¸é€‚åˆï¼šç®€å•åœºæ™¯ã€å¿«é€Ÿé…ç½®éœ€æ±‚
```

### 9.3 é…ç½®æœ€ä½³å®è·µ



**ğŸ”¹ åˆ†çº§é€šçŸ¥ç­–ç•¥**ï¼š
```
P0ï¼ˆä¸¥é‡ï¼‰ï¼šçŸ­ä¿¡ + å¾®ä¿¡ + é‚®ä»¶ + ç”µè¯
P1ï¼ˆé‡è¦ï¼‰ï¼šå¾®ä¿¡ + é‚®ä»¶
P2ï¼ˆä¸€èˆ¬ï¼‰ï¼šé‚®ä»¶
P3ï¼ˆæé†’ï¼‰ï¼šä»…è®°å½•æ—¥å¿—
```

**ğŸ”¹ é€šçŸ¥ä¼˜åŒ–å»ºè®®**ï¼š
- **é¿å…å‘Šè­¦é£æš´**ï¼šè®¾ç½®åˆç†çš„å‘é€é¢‘ç‡é™åˆ¶
- **å†…å®¹è¦ç²¾å‡†**ï¼šåŒ…å«è¶³å¤Ÿå®šä½é—®é¢˜çš„ä¿¡æ¯
- **æ—¶é—´è¦åˆé€‚**ï¼šå·¥ä½œæ—¶é—´å’Œéå·¥ä½œæ—¶é—´ä½¿ç”¨ä¸åŒç­–ç•¥
- **æµ‹è¯•è¦å……åˆ†**ï¼šå®šæœŸæµ‹è¯•å„ä¸ªé€šçŸ¥æ¸ é“çš„å¯ç”¨æ€§

### 9.4 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ



â“ **å¸¸è§é—®é¢˜FAQ**ï¼š

**Q: å‘Šè­¦é€šçŸ¥å‘é€å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**
**A:** æ£€æŸ¥ç½‘ç»œè¿æ¥ã€è®¤è¯ä¿¡æ¯ã€æœåŠ¡å•†é…é¢ï¼ŒæŸ¥çœ‹Alertmanageræ—¥å¿—

**Q: å¦‚ä½•é¿å…å‘Šè­¦é€šçŸ¥è¿‡å¤šï¼Ÿ**
**A:** è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼ã€ä½¿ç”¨åˆ†ç»„å’ŒæŠ‘åˆ¶åŠŸèƒ½ã€é…ç½®é™é»˜è§„åˆ™

**Q: ä¸åŒç¯å¢ƒå¦‚ä½•é…ç½®ä¸åŒçš„é€šçŸ¥æ–¹å¼ï¼Ÿ**
**A:** ä½¿ç”¨è·¯ç”±è§„åˆ™æ ¹æ®æ ‡ç­¾åˆ†å‘åˆ°ä¸åŒçš„receiver

âœ… **å­¦ä¹ æ£€æŸ¥ç‚¹**ï¼š
- [ ] èƒ½é…ç½®åŸºæœ¬çš„é‚®ä»¶å‘Šè­¦é€šçŸ¥
- [ ] ç†è§£Webhookçš„å·¥ä½œåŸç†å’Œåº”ç”¨åœºæ™¯
- [ ] èƒ½å¤Ÿé›†æˆä¼ä¸šå¾®ä¿¡æˆ–é’‰é’‰å‘Šè­¦
- [ ] æŒæ¡å‘Šè­¦æ¨¡æ¿çš„åŸºæœ¬è¯­æ³•å’Œå®šåˆ¶æ–¹æ³•
- [ ] èƒ½å¤Ÿè®¾è®¡åˆç†çš„å¤šæ¸ é“å‘Šè­¦ç­–ç•¥

ğŸ§  **è®°å¿†å£è¯€**ï¼š
"é‚®ä»¶è¯¦ç»†è®°å½•å…¨ï¼Œå¾®ä¿¡é’‰é’‰å“åº”å¿«
çŸ­ä¿¡ä¿åº•å¾ˆå…³é”®ï¼ŒWebhookè‡ªå®šä¹‰æœ€çµæ´»
æ¨¡æ¿ç¾åŒ–ç”¨æˆ·çˆ±ï¼Œåˆ†çº§é€šçŸ¥ä¸æ…Œä¹±"

**æ ¸å¿ƒè®°å¿†**ï¼š
- å‘Šè­¦é€šçŸ¥æ˜¯ç›‘æ§ç³»ç»Ÿçš„æœ€åä¸€ç¯ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç¯
- ä¸åŒåœºæ™¯é€‰æ‹©åˆé€‚çš„é€šçŸ¥æ–¹å¼ï¼Œå¤šæ¸ é“ä¿éšœä¸é—æ¼
- æ¨¡æ¿å®šåˆ¶èƒ½æ˜¾è‘—æå‡å‘Šè­¦ä¿¡æ¯çš„å¯è¯»æ€§å’Œå¤„ç†æ•ˆç‡
- åˆç†çš„é€šçŸ¥ç­–ç•¥èƒ½å¤Ÿå¹³è¡¡åŠæ—¶æ€§å’Œé¿å…éªšæ‰°çš„éœ€æ±‚