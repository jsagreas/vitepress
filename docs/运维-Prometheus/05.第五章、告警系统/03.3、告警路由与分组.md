---
title: 3ã€å‘Šè­¦è·¯ç”±ä¸åˆ†ç»„
---
## ğŸ“š ç›®å½•

1. [å‘Šè­¦è·¯ç”±åŸºç¡€æ¦‚å¿µ](#1-å‘Šè­¦è·¯ç”±åŸºç¡€æ¦‚å¿µ)
2. [è·¯ç”±é…ç½®æ ‘è¯¦è§£](#2-è·¯ç”±é…ç½®æ ‘è¯¦è§£)
3. [å‘Šè­¦åˆ†ç»„ç­–ç•¥](#3-å‘Šè­¦åˆ†ç»„ç­–ç•¥)
4. [å‘Šè­¦æŠ‘åˆ¶è§„åˆ™](#4-å‘Šè­¦æŠ‘åˆ¶è§„åˆ™)
5. [é™é»˜ç®¡ç†æœºåˆ¶](#5-é™é»˜ç®¡ç†æœºåˆ¶)
6. [æ¥æ”¶å™¨é…ç½®è¯¦è§£](#6-æ¥æ”¶å™¨é…ç½®è¯¦è§£)
7. [å‘Šè­¦å»é‡æœºåˆ¶](#7-å‘Šè­¦å»é‡æœºåˆ¶)
8. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#8-å®æˆ˜é…ç½®æ¡ˆä¾‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¦ å‘Šè­¦è·¯ç”±åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å‘Šè­¦è·¯ç”±


**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
æƒ³è±¡ä¸€ä¸‹é‚®å±€åˆ†æ‹£é‚®ä»¶çš„è¿‡ç¨‹ã€‚å½“æœ‰å¤§é‡é‚®ä»¶åˆ°è¾¾æ—¶ï¼Œé‚®å±€ä¸ä¼šæŠŠæ‰€æœ‰é‚®ä»¶éƒ½æ··åœ¨ä¸€èµ·å‘é€ï¼Œè€Œæ˜¯è¦æ ¹æ®åœ°å€ã€é‡è¦ç¨‹åº¦ç­‰ä¿¡æ¯ï¼ŒæŠŠé‚®ä»¶åˆ†ç±»é€åˆ°ä¸åŒçš„æŠ•é€’å‘˜æ‰‹ä¸­ã€‚Prometheusçš„å‘Šè­¦è·¯ç”±å°±æ˜¯è¿™æ ·ä¸€ä¸ª"æ™ºèƒ½é‚®å±€"ã€‚

```
ğŸ“® å‘Šè­¦è·¯ç”±çš„ä½œç”¨ï¼š
åŸå§‹å‘Šè­¦ â†’ è·¯ç”±è§„åˆ™åˆ¤æ–­ â†’ åˆ†ç»„å½’ç±» â†’ å‘é€ç»™å¯¹åº”æ¥æ”¶å™¨

å°±åƒï¼š
ç«è­¦ â†’ æ¶ˆé˜²é˜Ÿ
ç›—è­¦ â†’ è­¦å¯Ÿå±€  
æ€¥æ•‘ â†’ åŒ»é™¢
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å‘Šè­¦è·¯ç”±


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

ğŸ¯ **é¿å…å‘Šè­¦é£æš´**ï¼š
å‡è®¾ä½ çš„ç½‘ç«™æœ‰100å°æœåŠ¡å™¨ï¼Œå¦‚æœç½‘ç»œæ•…éšœå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨éƒ½æ— æ³•è®¿é—®ï¼Œæ²¡æœ‰è·¯ç”±çš„è¯ä½ ä¼šæ”¶åˆ°100æ¡ç›¸åŒçš„å‘Šè­¦ï¼Œæ‰‹æœºä¼šè¢«è½°ç‚¸ã€‚æœ‰äº†è·¯ç”±åˆ†ç»„ï¼Œè¿™100æ¡å‘Šè­¦ä¼šè¢«åˆå¹¶æˆ1æ¡"ç½‘ç»œæ•…éšœå½±å“100å°æœåŠ¡å™¨"ã€‚

ğŸ¯ **ç²¾å‡†é€šçŸ¥**ï¼š
ä¸åŒç±»å‹çš„é—®é¢˜éœ€è¦é€šçŸ¥ä¸åŒçš„äººï¼š
- æ•°æ®åº“é—®é¢˜ â†’ é€šçŸ¥DBA
- ç½‘ç»œé—®é¢˜ â†’ é€šçŸ¥ç½‘ç»œç®¡ç†å‘˜  
- åº”ç”¨é—®é¢˜ â†’ é€šçŸ¥å¼€å‘å›¢é˜Ÿ

ğŸ¯ **å‡å°‘å™ªéŸ³**ï¼š
é€šè¿‡æŠ‘åˆ¶è§„åˆ™ï¼Œé¿å…å‘é€é‡å¤æˆ–æ— å…³ç´§è¦çš„å‘Šè­¦ã€‚

### 1.3 å‘Šè­¦è·¯ç”±çš„åŸºæœ¬ç»„ä»¶


```
ğŸ“Š å‘Šè­¦è·¯ç”±æ¶æ„ï¼š
Prometheus Server (äº§ç”Ÿå‘Šè­¦)
         â†“
Alertmanager (å¤„ç†å‘Šè­¦)
    â”œâ”€â”€ è·¯ç”±è§„åˆ™ (route)
    â”œâ”€â”€ åˆ†ç»„ç­–ç•¥ (group_by)
    â”œâ”€â”€ æŠ‘åˆ¶è§„åˆ™ (inhibit_rules)
    â”œâ”€â”€ é™é»˜ç®¡ç† (silences)
    â””â”€â”€ æ¥æ”¶å™¨ (receivers)
         â†“
é€šçŸ¥æ¸ é“ (é‚®ä»¶/å¾®ä¿¡/é’‰é’‰ç­‰)
```

**ğŸ”‘ æ ¸å¿ƒé…ç½®æ–‡ä»¶ç»“æ„**ï¼š
```yaml
# alertmanager.yml åŸºæœ¬ç»“æ„
global:          # å…¨å±€é…ç½®
route:           # è·¯ç”±é…ç½®æ ‘
inhibit_rules:   # æŠ‘åˆ¶è§„åˆ™
receivers:       # æ¥æ”¶å™¨é…ç½®
```

---

## 2. ğŸŒ³ è·¯ç”±é…ç½®æ ‘è¯¦è§£


### 2.1 è·¯ç”±æ ‘çš„æ¦‚å¿µ


**æ ‘å½¢ç»“æ„ç†è§£**ï¼š
è·¯ç”±é…ç½®å°±åƒä¸€ä¸ªå€’ç«‹çš„å¤§æ ‘ï¼Œå‘Šè­¦ä»æ ‘æ ¹å¼€å§‹ï¼Œæ²¿ç€æ ‘æå‘ä¸‹æµåŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„"å¶å­"ï¼ˆæ¥æ”¶å™¨ï¼‰ã€‚

```
è·¯ç”±æ ‘ç¤ºä¾‹ï¼š
                æ ¹è·¯ç”± (root)
                     |
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    severity=critical    severity=warning    å…¶ä»–å‘Šè­¦
         |                   |                |
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”´â”€â”€â”€â”          é»˜è®¤å¤„ç†
team=db  team=app   team=ops team=dev        |
    |        |           |       |      é»˜è®¤æ¥æ”¶å™¨
DBAç»„   å¼€å‘ç»„        è¿ç»´ç»„   å¼€å‘ç»„
```

### 2.2 è·¯ç”±åŒ¹é…è§„åˆ™


**ğŸ¯ åŒ¹é…ä¼˜å…ˆçº§**ï¼š
å‘Šè­¦ä¼šæŒ‰ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºåŒ¹é…è·¯ç”±è§„åˆ™ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸå°±ä¸å†ç»§ç»­åŒ¹é…ä¸‹é¢çš„è§„åˆ™ï¼ˆé™¤éè®¾ç½®äº†`continue: true`ï¼‰ã€‚

**åŸºæœ¬åŒ¹é…è¯­æ³•**ï¼š
```yaml
route:
  # æ ¹è·¯ç”± - æ‰€æœ‰å‘Šè­¦çš„å…¥å£
  receiver: 'default-receiver'
  group_by: ['alertname', 'cluster']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  
  routes:
    # å­è·¯ç”±1ï¼šå¤„ç†æ•°æ®åº“ç›¸å…³å‘Šè­¦
    - match:
        service: mysql
      receiver: 'database-team'
      group_by: ['alertname', 'instance']
      
    # å­è·¯ç”±2ï¼šå¤„ç†é«˜ä¼˜å…ˆçº§å‘Šè­¦
    - match:
        severity: critical
      receiver: 'ops-oncall'
      group_wait: 10s     # ä¸¥é‡å‘Šè­¦å¿«é€Ÿå‘é€
      repeat_interval: 5m  # é¢‘ç¹é‡å¤æé†’
      
    # å­è·¯ç”±3ï¼šå¤„ç†å¼€å‘ç¯å¢ƒå‘Šè­¦
    - match_re:
        environment: ^(dev|test).*
      receiver: 'dev-team'
      group_interval: 30m  # å¼€å‘ç¯å¢ƒå‘Šè­¦ä¸é‚£ä¹ˆæ€¥
```

### 2.3 åŒ¹é…å™¨ç±»å‹è¯¦è§£


**ğŸ” ç²¾ç¡®åŒ¹é… (match)**ï¼š
```yaml
# å®Œå…¨ç›¸ç­‰åŒ¹é…
match:
  severity: critical
  team: database
  environment: production
```

**ğŸ” æ­£åˆ™åŒ¹é… (match_re)**ï¼š
```yaml
# æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
match_re:
  instance: ^db-[0-9]+\.example\.com$
  alertname: ^(MySQL|PostgreSQL).*
  environment: ^(prod|production)$
```

**ğŸ’¡ å®ç”¨åŒ¹é…æ¡ˆä¾‹**ï¼š
```yaml
routes:
  # åŒ¹é…æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒçš„ä¸¥é‡å‘Šè­¦
  - match:
      severity: critical
      environment: production
    receiver: 'emergency-team'
    
  # åŒ¹é…ç‰¹å®šæœåŠ¡å™¨ç»„çš„å‘Šè­¦
  - match_re:
      instance: ^web-server-[0-9]+
    receiver: 'web-team'
    
  # åŒ¹é…å¤šä¸ªæ•°æ®åº“ç±»å‹
  - match_re:
      service: ^(mysql|postgresql|redis)$
    receiver: 'database-team'
```

### 2.4 è·¯ç”±å‚æ•°è¯¦è§£


**â° æ—¶é—´ç›¸å…³å‚æ•°**ï¼š

| å‚æ•° | **å«ä¹‰** | **é»˜è®¤å€¼** | **æ¨èè®¾ç½®** |
|------|----------|------------|--------------|
| `group_wait` | `ç­‰å¾…åŒç»„å‘Šè­¦çš„æ—¶é—´` | `10s` | `ä¸¥é‡:10s, ä¸€èˆ¬:30s` |
| `group_interval` | `åŒç»„å‘Šè­¦é‡å‘é—´éš”` | `5m` | `ä¸¥é‡:2m, ä¸€èˆ¬:10m` |
| `repeat_interval` | `é‡å¤å‘é€é—´éš”` | `4h` | `ä¸¥é‡:30m, ä¸€èˆ¬:4h` |

**ğŸ§  å‚æ•°å«ä¹‰è§£é‡Š**ï¼š

**group_wait**ï¼šå°±åƒç­‰ç”µæ¢¯ä¸€æ ·ï¼Œä¸ä¼šä¸€ä¸ªäººæ¥å°±å¼€ï¼Œä¼šç­‰ä¸€ç­‰çœ‹è¿˜æœ‰æ²¡æœ‰äººï¼ŒæŠŠç›¸ä¼¼çš„å‘Šè­¦æ”’åœ¨ä¸€èµ·å‘é€ã€‚

**group_interval**ï¼šç¬¬ä¸€æ¬¡å‘é€åï¼Œå¦‚æœåˆæ¥äº†åŒç±»å‘Šè­¦ï¼Œç­‰å¤šé•¿æ—¶é—´å†å‘ç¬¬äºŒæ‰¹ã€‚

**repeat_interval**ï¼šå¦‚æœå‘Šè­¦ä¸€ç›´æ²¡è§£å†³ï¼Œæ¯éš”å¤šé•¿æ—¶é—´é‡æ–°æé†’ä¸€æ¬¡ã€‚

---

## 3. ğŸ“¦ å‘Šè­¦åˆ†ç»„ç­–ç•¥


### 3.1 åˆ†ç»„çš„ä½œç”¨


**ä¸ºä»€ä¹ˆè¦åˆ†ç»„ï¼Ÿ**
æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªå€¼ç­å·¥ç¨‹å¸ˆï¼Œå‡Œæ™¨2ç‚¹æ”¶åˆ°å‘Šè­¦ã€‚å¦‚æœæ¯ä¸ªæœåŠ¡å™¨é—®é¢˜éƒ½å•ç‹¬å‘ä¸€æ¡æ¶ˆæ¯ï¼Œä½ çš„æ‰‹æœºä¼šå“ä¸ªä¸åœã€‚ä½†å¦‚æœæŠŠç›¸å…³çš„å‘Šè­¦åˆå¹¶æˆä¸€æ¡æ¶ˆæ¯ï¼Œä½ å°±èƒ½å¿«é€Ÿäº†è§£é—®é¢˜çš„å…¨è²Œã€‚

```
âŒ ä¸åˆ†ç»„çš„æ•ˆæœï¼š
æ¶ˆæ¯1ï¼šweb-01æœåŠ¡å™¨CPUä½¿ç”¨ç‡95%
æ¶ˆæ¯2ï¼šweb-02æœåŠ¡å™¨CPUä½¿ç”¨ç‡94%
æ¶ˆæ¯3ï¼šweb-03æœåŠ¡å™¨CPUä½¿ç”¨ç‡96%
... (å¯èƒ½æœ‰å‡ åæ¡)

âœ… åˆ†ç»„åçš„æ•ˆæœï¼š
æ¶ˆæ¯ï¼šã€é«˜CPUä½¿ç”¨ç‡å‘Šè­¦ã€‘å½±å“3å°webæœåŠ¡å™¨
è¯¦æƒ…ï¼šweb-01(95%), web-02(94%), web-03(96%)
```

### 3.2 åˆ†ç»„ç­–ç•¥é…ç½®


**ğŸ”¤ åŸºç¡€åˆ†ç»„æ ‡ç­¾**ï¼š
```yaml
# æŒ‰å‘Šè­¦åç§°åˆ†ç»„
group_by: ['alertname']

# æŒ‰æœåŠ¡å’Œç¯å¢ƒåˆ†ç»„
group_by: ['service', 'environment']

# æŒ‰é›†ç¾¤å’Œå›¢é˜Ÿåˆ†ç»„
group_by: ['cluster', 'team']

# ä¸åˆ†ç»„ï¼ˆæ¯ä¸ªå‘Šè­¦å•ç‹¬å‘é€ï¼‰
group_by: []
```

**ğŸ¯ å®é™…åˆ†ç»„æ¡ˆä¾‹**ï¼š

```yaml
route:
  routes:
    # æ•°æ®åº“å‘Šè­¦æŒ‰å®ä¾‹åˆ†ç»„
    - match:
        service: mysql
      receiver: 'dba-team'
      group_by: ['alertname', 'instance']
      # æ•ˆæœï¼šMySQLè¿æ¥æ•°è¿‡é«˜ä¼šæŒ‰ä¸åŒæ•°æ®åº“å®ä¾‹åˆ†ç»„
      
    # WebæœåŠ¡æŒ‰å¯ç”¨åŒºåˆ†ç»„  
    - match:
        service: nginx
      receiver: 'web-team'
      group_by: ['alertname', 'availability_zone']
      # æ•ˆæœï¼šåŒä¸€å¯ç”¨åŒºçš„nginxé—®é¢˜ä¼šåˆå¹¶å‘é€
      
    # ç½‘ç»œå‘Šè­¦æŒ‰äº¤æ¢æœºåˆ†ç»„
    - match:
        component: network
      receiver: 'network-team'
      group_by: ['alertname', 'switch_ip']
      # æ•ˆæœï¼šåŒä¸€äº¤æ¢æœºä¸‹çš„ç½‘ç»œé—®é¢˜ä¼šåˆå¹¶
```

### 3.3 åˆ†ç»„ç­–ç•¥æœ€ä½³å®è·µ


**ğŸ“‹ åˆ†ç»„é€‰æ‹©æŒ‡å—**ï¼š

```
ğŸ”¸ é€‰æ‹©åˆ†ç»„æ ‡ç­¾çš„åŸåˆ™ï¼š
1. é—®é¢˜ç›¸å…³æ€§ï¼šç›¸å…³çš„é—®é¢˜åº”è¯¥åˆ†åœ¨ä¸€ç»„
2. å¤„ç†äººå‘˜ï¼šåŒä¸€å›¢é˜Ÿå¤„ç†çš„é—®é¢˜åˆ†ç»„
3. å½±å“èŒƒå›´ï¼šå½±å“ç›¸åŒä¸šåŠ¡çš„é—®é¢˜åˆ†ç»„
4. ç´§æ€¥ç¨‹åº¦ï¼šç›¸åŒä¼˜å…ˆçº§çš„é—®é¢˜åˆ†ç»„

ğŸ”¸ å¸¸ç”¨åˆ†ç»„æ¨¡å¼ï¼š
â€¢ æŒ‰æœåŠ¡åˆ†ç»„ï¼šé€‚åˆå¾®æœåŠ¡æ¶æ„
â€¢ æŒ‰ç¯å¢ƒåˆ†ç»„ï¼šåŒºåˆ†ç”Ÿäº§ã€æµ‹è¯•ã€å¼€å‘
â€¢ æŒ‰å›¢é˜Ÿåˆ†ç»„ï¼šä¸åŒå›¢é˜Ÿè´Ÿè´£ä¸åŒç³»ç»Ÿ
â€¢ æŒ‰åœ°åŸŸåˆ†ç»„ï¼šå¤šæœºæˆ¿éƒ¨ç½²åœºæ™¯
```

**âš–ï¸ åˆ†ç»„ç²’åº¦æƒè¡¡**ï¼š

```
è¿‡ç»†åˆ†ç»„çš„é—®é¢˜ï¼š
âŒ å‘Šè­¦è¿‡äºåˆ†æ•£
âŒ é‡è¦ä¿¡æ¯è¢«ç¨€é‡Š
âŒ å¢åŠ å¤„ç†æˆæœ¬

è¿‡ç²—åˆ†ç»„çš„é—®é¢˜ï¼š
âŒ ä¸ç›¸å…³å‘Šè­¦æ··åœ¨ä¸€èµ·
âŒ å½±å“é—®é¢˜å®šä½
âŒ é€šçŸ¥ä¸å¤Ÿç²¾å‡†

æœ€ä½³å®è·µï¼š
âœ… æ ¹æ®å›¢é˜Ÿç»„ç»‡ç»“æ„è®¾è®¡åˆ†ç»„
âœ… è€ƒè™‘å‘Šè­¦çš„ä¸šåŠ¡ç›¸å…³æ€§
âœ… å¹³è¡¡ä¿¡æ¯å®Œæ•´æ€§å’Œå¯è¯»æ€§
```

---

## 4. ğŸš« å‘Šè­¦æŠ‘åˆ¶è§„åˆ™


### 4.1 æŠ‘åˆ¶è§„åˆ™çš„ä½œç”¨


**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
å°±åƒå®¶é‡Œçš„çƒŸé›¾æŠ¥è­¦å™¨å“äº†ï¼Œä½ ä¸å¸Œæœ›åŒæ—¶å“èµ·çš„è¿˜æœ‰"å¨æˆ¿æ¸©åº¦è¿‡é«˜"ã€"ç©ºæ°”è´¨é‡å¼‚å¸¸"ç­‰å…¶ä»–æŠ¥è­¦å™¨ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯ç”±åŒä¸€ä¸ªæ ¹æœ¬åŸå› ï¼ˆç«ç¾ï¼‰å¼•èµ·çš„ã€‚å‘Šè­¦æŠ‘åˆ¶å°±æ˜¯è¿™æ ·çš„é€»è¾‘ã€‚

```
ğŸ¯ æŠ‘åˆ¶åœºæ™¯ç¤ºä¾‹ï¼š
ä¸»è¦å‘Šè­¦ï¼šæœåŠ¡å™¨å®•æœº
è¢«æŠ‘åˆ¶çš„å‘Šè­¦ï¼š
  â”œâ”€â”€ CPUä½¿ç”¨ç‡æ— æ³•è·å–
  â”œâ”€â”€ å†…å­˜ä½¿ç”¨ç‡æ— æ³•è·å–  
  â”œâ”€â”€ ç£ç›˜ç©ºé—´æ— æ³•è·å–
  â””â”€â”€ ç½‘ç»œè¿æ¥ä¸­æ–­

å› ä¸ºæœåŠ¡å™¨éƒ½å®•æœºäº†ï¼Œå…¶ä»–ç›‘æ§æŒ‡æ ‡å½“ç„¶ä¹Ÿè·å–ä¸åˆ°äº†
```

### 4.2 æŠ‘åˆ¶è§„åˆ™é…ç½®


**ğŸ”§ åŸºæœ¬æŠ‘åˆ¶è¯­æ³•**ï¼š
```yaml
inhibit_rules:
  # è§„åˆ™1ï¼šæœåŠ¡å™¨å®•æœºæ—¶æŠ‘åˆ¶å…¶ä»–èµ„æºå‘Šè­¦
  - source_match:
      alertname: InstanceDown
    target_match:
      alertname: HighCpuUsage
    equal: ['instance']
    # å«ä¹‰ï¼šå¦‚æœæŸä¸ªå®ä¾‹çš„InstanceDownå‘Šè­¦è§¦å‘ï¼Œ
    # å°±æŠ‘åˆ¶åŒä¸€å®ä¾‹çš„HighCpuUsageå‘Šè­¦
    
  # è§„åˆ™2ï¼šç½‘ç»œæ•…éšœæ—¶æŠ‘åˆ¶åº”ç”¨å‘Šè­¦
  - source_match:
      severity: critical
      component: network
    target_match:
      severity: warning
      component: application
    equal: ['datacenter']
    # å«ä¹‰ï¼šç½‘ç»œæ•…éšœæ—¶ï¼ŒæŠ‘åˆ¶åŒä¸€æ•°æ®ä¸­å¿ƒçš„åº”ç”¨å‘Šè­¦
```

### 4.3 æŠ‘åˆ¶è§„åˆ™å‚æ•°è¯¦è§£


**ğŸ¯ å…³é”®å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | **ä½œç”¨** | **ç¤ºä¾‹** |
|------|----------|----------|
| `source_match` | `æŠ‘åˆ¶æºæ¡ä»¶` | `æœåŠ¡å™¨å®•æœºå‘Šè­¦` |
| `target_match` | `è¢«æŠ‘åˆ¶ç›®æ ‡` | `CPU/å†…å­˜å‘Šè­¦` |
| `equal` | `åŒ¹é…ç»´åº¦` | `['instance', 'job']` |

**ğŸ’¡ å®é™…æŠ‘åˆ¶æ¡ˆä¾‹**ï¼š

```yaml
inhibit_rules:
  # æ¡ˆä¾‹1ï¼šæ•°æ®åº“ä¸»ä»åˆ‡æ¢åœºæ™¯
  - source_match:
      alertname: DatabaseFailover
      severity: critical
    target_match_re:
      alertname: ^(DatabaseConnectionError|DatabaseSlowQuery)$
    equal: ['cluster']
    # ä¸»ä»åˆ‡æ¢æ—¶æŠ‘åˆ¶è¿æ¥å’Œæ…¢æŸ¥è¯¢å‘Šè­¦
    
  # æ¡ˆä¾‹2ï¼šæœºæˆ¿æ–­ç”µåœºæ™¯
  - source_match:
      alertname: DatacenterPowerFailure
    target_match_re:
      alertname: ^(InstanceDown|NetworkUnreachable)$
    equal: ['datacenter']
    # æœºæˆ¿æ–­ç”µæ—¶æŠ‘åˆ¶æœåŠ¡å™¨å’Œç½‘ç»œå‘Šè­¦
    
  # æ¡ˆä¾‹3ï¼šè´Ÿè½½å‡è¡¡å™¨æ•…éšœ
  - source_match:
      alertname: LoadBalancerDown
      service: nginx
    target_match:
      alertname: ServiceUnavailable
    equal: ['cluster', 'environment']
    # è´Ÿè½½å‡è¡¡å™¨æ•…éšœæ—¶æŠ‘åˆ¶æœåŠ¡ä¸å¯ç”¨å‘Šè­¦
```

### 4.4 æŠ‘åˆ¶è§„åˆ™è®¾è®¡åŸåˆ™


**ğŸ“‹ è®¾è®¡æŒ‡å¯¼åŸåˆ™**ï¼š

```
ğŸ”¸ å› æœå…³ç³»åŸåˆ™ï¼š
â€¢ æŠ‘åˆ¶æºåº”è¯¥æ˜¯æ ¹æœ¬åŸå› 
â€¢ è¢«æŠ‘åˆ¶çš„åº”è¯¥æ˜¯è¡ç”Ÿé—®é¢˜
â€¢ é¿å…å¾ªç¯æŠ‘åˆ¶

ğŸ”¸ å½±å“èŒƒå›´åŸåˆ™ï¼š
â€¢ equalå‚æ•°è¦é€‰æ‹©åˆé€‚çš„æ ‡ç­¾
â€¢ ç¡®ä¿æŠ‘åˆ¶èŒƒå›´ä¸ä¼šè¿‡å¤§
â€¢ é¿å…è¯¯æ€é‡è¦å‘Šè­¦

ğŸ”¸ æ—¶æ•ˆæ€§åŸåˆ™ï¼š
â€¢ æŠ‘åˆ¶è§„åˆ™è¦åŠæ—¶ç”Ÿæ•ˆ
â€¢ æ ¹æœ¬é—®é¢˜è§£å†³åè¦åŠæ—¶è§£é™¤æŠ‘åˆ¶
â€¢ å®šæœŸæ£€æŸ¥æŠ‘åˆ¶è§„åˆ™çš„æœ‰æ•ˆæ€§
```

**âš ï¸ å¸¸è§æŠ‘åˆ¶è¯¯åŒº**ï¼š

```
âŒ é”™è¯¯åšæ³•ï¼š
â€¢ æŠ‘åˆ¶èŒƒå›´è¿‡å¤§ï¼Œé‡è¦å‘Šè­¦è¢«è¯¯æ€
â€¢ æŠ‘åˆ¶é€»è¾‘è¿‡äºå¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤
â€¢ æ²¡æœ‰è€ƒè™‘æ—¶é—´å› ç´ ï¼Œé•¿æœŸæŠ‘åˆ¶

âœ… æ­£ç¡®åšæ³•ï¼š
â€¢ ç²¾ç¡®åŒ¹é…æŠ‘åˆ¶èŒƒå›´
â€¢ ä¿æŒæŠ‘åˆ¶é€»è¾‘ç®€å•æ˜äº†
â€¢ å®šæœŸå®¡æŸ¥å’Œæ›´æ–°æŠ‘åˆ¶è§„åˆ™
â€¢ ä¸ºå…³é”®å‘Šè­¦è®¾ç½®ä¾‹å¤–æƒ…å†µ
```

---

## 5. ğŸ”‡ é™é»˜ç®¡ç†æœºåˆ¶


### 5.1 é™é»˜çš„æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯é™é»˜ï¼Ÿ**
é™é»˜å°±åƒç»™æ‰‹æœºè®¾ç½®"å‹¿æ‰°æ¨¡å¼"ã€‚å½“ä½ çŸ¥é“æŸä¸ªç³»ç»Ÿæ­£åœ¨ç»´æŠ¤ï¼Œæˆ–è€…æŸä¸ªå‘Šè­¦æ˜¯å·²çŸ¥é—®é¢˜æ—¶ï¼Œå¯ä»¥ä¸´æ—¶"é™é»˜"è¿™äº›å‘Šè­¦ï¼Œé¿å…ä¸å¿…è¦çš„å™ªéŸ³ã€‚

```
ğŸ¯ é™é»˜ä½¿ç”¨åœºæ™¯ï¼š
â€¢ è®¡åˆ’ç»´æŠ¤ï¼šæœåŠ¡å™¨å‡çº§ã€ç½‘ç»œå‰²æ¥
â€¢ å·²çŸ¥é—®é¢˜ï¼šæ­£åœ¨ä¿®å¤ä¸­çš„bug
â€¢ æµ‹è¯•ç¯å¢ƒï¼šå¼€å‘æµ‹è¯•äº§ç”Ÿçš„å‘Šè­¦
â€¢ è¯¯æŠ¥å¤„ç†ï¼šç¡®è®¤æ˜¯è¯¯æŠ¥çš„å‘Šè­¦
```

### 5.2 é™é»˜æ“ä½œæ–¹å¼


**ğŸ–¥ï¸ Webç•Œé¢æ“ä½œ**ï¼š
```
1. æ‰“å¼€Alertmanager Webç•Œé¢
2. ç‚¹å‡»"Silences"èœå•
3. ç‚¹å‡»"New Silence"æŒ‰é’®
4. è®¾ç½®é™é»˜æ¡ä»¶ï¼š
   - æ ‡ç­¾åŒ¹é…å™¨ï¼ˆå¦‚ï¼šinstance=web-01ï¼‰
   - é™é»˜æ—¶é—´ï¼ˆå¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼‰
   - é™é»˜åŸå› ï¼ˆå¿…å¡«ï¼Œç”¨äºè®°å½•ï¼‰
5. æäº¤é™é»˜è§„åˆ™
```

**ğŸ’» å‘½ä»¤è¡Œæ“ä½œ**ï¼š
```bash
# å®‰è£…amtoolå‘½ä»¤è¡Œå·¥å…·
go install github.com/prometheus/alertmanager/cmd/amtool@latest

# åˆ›å»ºé™é»˜ï¼ˆç»´æŠ¤çª—å£ï¼‰
amtool silence add \
  instance=web-01.example.com \
  --duration=2h \
  --comment="æœåŠ¡å™¨ç³»ç»Ÿå‡çº§ç»´æŠ¤"

# æŸ¥çœ‹å½“å‰é™é»˜
amtool silence query

# åˆ é™¤é™é»˜
amtool silence expire <silence-id>
```

### 5.3 é™é»˜è§„åˆ™è®¾è®¡


**ğŸ¯ æ ‡ç­¾åŒ¹é…å™¨**ï¼š
```
ç²¾ç¡®åŒ¹é…ï¼š
instance=web-01.example.com

æ­£åˆ™åŒ¹é…ï¼š
instance=~"web-[0-9]+\.example\.com"

å¤šæ ‡ç­¾ç»„åˆï¼š
service=mysql,environment=production

æ’é™¤æŸäº›æ ‡ç­¾ï¼š
service!=monitoring
```

**â° æ—¶é—´ç®¡ç†ç­–ç•¥**ï¼š

```yaml
# é™é»˜æ—¶é—´è®¾ç½®å»ºè®®
çŸ­æœŸé™é»˜ï¼ˆ< 1å°æ—¶ï¼‰ï¼š
  - å¿«é€Ÿé—®é¢˜ä¿®å¤
  - ä¸´æ—¶é…ç½®è°ƒæ•´
  - æµ‹è¯•éªŒè¯

ä¸­æœŸé™é»˜ï¼ˆ1-8å°æ—¶ï¼‰ï¼š
  - ç³»ç»Ÿç»´æŠ¤çª—å£
  - è½¯ä»¶å‡çº§éƒ¨ç½²
  - ç½‘ç»œè®¾å¤‡ç»´æŠ¤

é•¿æœŸé™é»˜ï¼ˆ> 8å°æ—¶ï¼‰ï¼š
  - ç¡¬ä»¶æ›´æ¢
  - æœºæˆ¿è¿ç§»
  - å¤§å‹ç³»ç»Ÿé‡æ„
```

### 5.4 é™é»˜ç®¡ç†æœ€ä½³å®è·µ


**ğŸ“‹ é™é»˜ç®¡ç†è§„èŒƒ**ï¼š

```
ğŸ”¸ é™é»˜åˆ›å»ºè§„èŒƒï¼š
â€¢ å¿…é¡»å¡«å†™æ¸…æ™°çš„é™é»˜åŸå› 
â€¢ è®¾ç½®åˆç†çš„é™é»˜æ—¶é—´
â€¢ é€‰æ‹©ç²¾ç¡®çš„åŒ¹é…æ¡ä»¶
â€¢ é¿å…è¿‡åº¦é™é»˜

ğŸ”¸ é™é»˜ç›‘æ§ï¼š
â€¢ å®šæœŸæ£€æŸ¥æ´»è·ƒçš„é™é»˜è§„åˆ™
â€¢ åŠæ—¶æ¸…ç†è¿‡æœŸçš„é™é»˜
â€¢ ç›‘æ§é™é»˜ä½¿ç”¨æƒ…å†µ
â€¢ å»ºç«‹é™é»˜æ“ä½œå®¡è®¡
```

**âš ï¸ é™é»˜ä½¿ç”¨æ³¨æ„äº‹é¡¹**ï¼š

```
å®‰å…¨è€ƒè™‘ï¼š
âŒ ä¸è¦å¯¹å…³é”®ä¸šåŠ¡å‘Šè­¦è®¾ç½®é•¿æœŸé™é»˜
âŒ é¿å…ä½¿ç”¨è¿‡äºå®½æ³›çš„åŒ¹é…æ¡ä»¶
âŒ ä¸è¦å¿˜è®°åŠæ—¶è§£é™¤ä¸´æ—¶é™é»˜

æœ€ä½³å®è·µï¼š
âœ… ä¸ºç»´æŠ¤çª—å£è®¾ç½®é¢„å®šé™é»˜
âœ… è®°å½•é™é»˜åŸå› å’Œè´Ÿè´£äºº
âœ… è®¾ç½®é™é»˜åˆ°æœŸæé†’
âœ… å»ºç«‹é™é»˜æ“ä½œæµç¨‹
```

---

## 6. ğŸ“§ æ¥æ”¶å™¨é…ç½®è¯¦è§£


### 6.1 æ¥æ”¶å™¨çš„ä½œç”¨


**ä»€ä¹ˆæ˜¯æ¥æ”¶å™¨ï¼Ÿ**
æ¥æ”¶å™¨å°±åƒä¸åŒçš„"é€šä¿¡æ¸ é“"ï¼Œå‘Šè­¦ç»è¿‡è·¯ç”±åˆ†ç»„åï¼Œæœ€ç»ˆè¦é€šè¿‡è¿™äº›æ¸ é“å‘é€ç»™ç›¸å…³äººå‘˜ã€‚ä¸åŒçš„æ¥æ”¶å™¨æ”¯æŒä¸åŒçš„é€šçŸ¥æ–¹å¼ã€‚

```
ğŸ“ å¸¸è§æ¥æ”¶å™¨ç±»å‹ï¼š
email     â†’ é‚®ä»¶é€šçŸ¥
slack     â†’ Slackæ¶ˆæ¯  
webhook   â†’ è‡ªå®šä¹‰æ¥å£
wechat    â†’ å¾®ä¿¡é€šçŸ¥
dingtalk  â†’ é’‰é’‰é€šçŸ¥
pagerduty â†’ å€¼ç­ç®¡ç†å¹³å°
```

### 6.2 é‚®ä»¶æ¥æ”¶å™¨é…ç½®


**ğŸ“§ åŸºç¡€é‚®ä»¶é…ç½®**ï¼š
```yaml
global:
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alerts@example.com'
  smtp_auth_username: 'alerts@example.com'
  smtp_auth_password: 'your-email-password'

receivers:
  - name: 'email-team'
    email_configs:
      - to: 'ops-team@example.com'
        subject: 'ã€å‘Šè­¦ã€‘{{.GroupLabels.alertname}} - {{.GroupLabels.instance}}'
        body: |
          å‘Šè­¦è¯¦æƒ…ï¼š
          æ—¶é—´ï¼š{{.CommonAnnotations.timestamp}}
          çº§åˆ«ï¼š{{.CommonLabels.severity}}
          æè¿°ï¼š{{.CommonAnnotations.summary}}
          
          å½±å“å®ä¾‹ï¼š
          {{range .Alerts}}
          - {{.Labels.instance}}: {{.Annotations.description}}
          {{end}}
```

**ğŸ¨ é‚®ä»¶æ¨¡æ¿ä¼˜åŒ–**ï¼š
```yaml
email_configs:
  - to: 'dba-team@example.com'
    subject: >
      {{if eq .Status "firing"}}ğŸ”¥{{else}}âœ…{{end}}
      ã€{{.CommonLabels.severity | upper}}ã€‘
      {{.CommonLabels.alertname}}
    html: |
      <h2 style="color: {{if eq .Status "firing"}}red{{else}}green{{end}}">
        å‘Šè­¦çŠ¶æ€ï¼š{{.Status | title}}
      </h2>
      <table border="1" style="border-collapse: collapse;">
        <tr><th>æ ‡ç­¾</th><th>å€¼</th></tr>
        {{range $k, $v := .CommonLabels}}
        <tr><td>{{$k}}</td><td>{{$v}}</td></tr>
        {{end}}
      </table>
```

### 6.3 Webhookæ¥æ”¶å™¨é…ç½®


**ğŸ”— åŸºç¡€Webhooké…ç½®**ï¼š
```yaml
receivers:
  - name: 'webhook-alerts'
    webhook_configs:
      - url: 'http://your-server.com/webhook/alerts'
        http_config:
          basic_auth:
            username: 'webhook-user'
            password: 'webhook-pass'
        send_resolved: true  # å‘é€æ¢å¤é€šçŸ¥
```

**ğŸ“ Webhookæ•°æ®æ ¼å¼**ï¼š
Alertmanagerä¼šå‘Webhookå‘é€JSONæ ¼å¼çš„æ•°æ®ï¼š
```json
{
  "version": "4",
  "groupKey": "{}:{alertname=\"HighCPU\"}",
  "status": "firing",
  "receiver": "webhook-alerts",
  "groupLabels": {
    "alertname": "HighCPU"
  },
  "commonLabels": {
    "alertname": "HighCPU",
    "instance": "web-01:9100",
    "severity": "warning"
  },
  "alerts": [
    {
      "status": "firing",
      "labels": {
        "alertname": "HighCPU",
        "instance": "web-01:9100"
      },
      "annotations": {
        "description": "CPUä½¿ç”¨ç‡è¶…è¿‡80%",
        "summary": "æœåŠ¡å™¨CPUè´Ÿè½½è¿‡é«˜"
      },
      "startsAt": "2023-01-01T12:00:00Z"
    }
  ]
}
```

### 6.4 è‡ªå®šä¹‰é€šçŸ¥æ¸ é“


**ğŸ’¬ é’‰é’‰æœºå™¨äººé›†æˆ**ï¼š
```yaml
receivers:
  - name: 'dingtalk-alerts'
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN'
        http_config:
          headers:
            Content-Type: application/json
        send_resolved: true
```

**ğŸ“± å¾®ä¿¡ä¼ä¸šå·é›†æˆ**ï¼š
```yaml
receivers:
  - name: 'wechat-alerts'
    wechat_configs:
      - api_url: 'https://qyapi.weixin.qq.com/cgi-bin/'
        corp_id: 'your-corp-id'
        agent_id: 'your-agent-id'
        api_secret: 'your-api-secret'
        to_user: 'user1|user2'
        message: |
          å‘Šè­¦ï¼š{{.CommonLabels.alertname}}
          çŠ¶æ€ï¼š{{.Status}}
          æè¿°ï¼š{{.CommonAnnotations.summary}}
```

### 6.5 æ¥æ”¶å™¨é…ç½®æœ€ä½³å®è·µ


**ğŸ“‹ æ¥æ”¶å™¨è®¾è®¡åŸåˆ™**ï¼š

```
ğŸ”¸ åˆ†å±‚é€šçŸ¥ç­–ç•¥ï¼š
ç¬¬ä¸€å±‚ï¼šå³æ—¶é€šçŸ¥ï¼ˆçŸ­ä¿¡ã€ç”µè¯ï¼‰
ç¬¬äºŒå±‚ï¼šè¯¦ç»†é€šçŸ¥ï¼ˆé‚®ä»¶ã€IMï¼‰
ç¬¬ä¸‰å±‚ï¼šè®°å½•é€šçŸ¥ï¼ˆå·¥å•ç³»ç»Ÿï¼‰

ğŸ”¸ é€šçŸ¥å†…å®¹ä¼˜åŒ–ï¼š
â€¢ æ ‡é¢˜ç®€æ´æ˜äº†ï¼ŒåŒ…å«å…³é”®ä¿¡æ¯
â€¢ å†…å®¹ç»“æ„åŒ–ï¼Œä¾¿äºå¿«é€Ÿç†è§£
â€¢ åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
â€¢ æä¾›é—®é¢˜è§£å†³é“¾æ¥

ğŸ”¸ å¯é æ€§ä¿éšœï¼š
â€¢ é…ç½®å¤šä¸ªå¤‡ç”¨æ¥æ”¶å™¨
â€¢ è®¾ç½®é€šçŸ¥å¤±è´¥é‡è¯•æœºåˆ¶
â€¢ ç›‘æ§é€šçŸ¥æ¸ é“çš„å¯ç”¨æ€§
â€¢ å®šæœŸæµ‹è¯•å‘Šè­¦é€šçŸ¥æµç¨‹
```

**âš¡ é«˜çº§æ¥æ”¶å™¨åŠŸèƒ½**ï¼š

```yaml
receivers:
  - name: 'multi-channel'
    # å¹¶è¡Œå‘é€åˆ°å¤šä¸ªæ¸ é“
    email_configs:
      - to: 'ops@example.com'
    slack_configs:
      - api_url: 'your-slack-webhook'
        channel: '#alerts'
    webhook_configs:
      - url: 'http://ticket-system.com/api/create'
        # è‡ªåŠ¨åˆ›å»ºå·¥å•
```

---

## 7. ğŸ”„ å‘Šè­¦å»é‡æœºåˆ¶


### 7.1 å»é‡çš„å¿…è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦å‘Šè­¦å»é‡ï¼Ÿ**
æƒ³è±¡ä½ è®¾ç½®äº†å¤šä¸ªç›‘æ§ç³»ç»Ÿï¼Œéƒ½åœ¨ç›‘æ§åŒä¸€å°æœåŠ¡å™¨çš„CPUä½¿ç”¨ç‡ã€‚å¦‚æœCPUçœŸçš„å‡ºç°é—®é¢˜ï¼Œä½ å¯èƒ½ä¼šåŒæ—¶æ”¶åˆ°æ¥è‡ªä¸åŒç›‘æ§ç³»ç»Ÿçš„ç›¸åŒå‘Šè­¦ã€‚å»é‡æœºåˆ¶å°±æ˜¯ä¸ºäº†é¿å…è¿™ç§é‡å¤é€šçŸ¥ã€‚

```
âŒ æ²¡æœ‰å»é‡çš„æƒ…å†µï¼š
å‘Šè­¦1ï¼šæ¥è‡ªç›‘æ§ç³»ç»ŸA - web-01 CPUä½¿ç”¨ç‡95%
å‘Šè­¦2ï¼šæ¥è‡ªç›‘æ§ç³»ç»ŸB - web-01 CPUä½¿ç”¨ç‡95%  
å‘Šè­¦3ï¼šæ¥è‡ªç›‘æ§ç³»ç»ŸC - web-01 CPUä½¿ç”¨ç‡95%

âœ… æœ‰å»é‡çš„æƒ…å†µï¼š
å‘Šè­¦ï¼šweb-01 CPUä½¿ç”¨ç‡95%ï¼ˆå·²åˆå¹¶3ä¸ªç›¸åŒå‘Šè­¦æºï¼‰
```

### 7.2 å»é‡æœºåˆ¶åŸç†


**ğŸ” å»é‡åˆ¤æ–­é€»è¾‘**ï¼š
Alertmanageré€šè¿‡æ¯”è¾ƒå‘Šè­¦çš„"æŒ‡çº¹"æ¥åˆ¤æ–­æ˜¯å¦ä¸ºé‡å¤å‘Šè­¦ã€‚æŒ‡çº¹ç”±å‘Šè­¦çš„æ ‡ç­¾ç»„åˆç”Ÿæˆã€‚

```
å‘Šè­¦æŒ‡çº¹ç”Ÿæˆï¼š
å‘Šè­¦1ï¼š{alertname="HighCPU", instance="web-01", job="node"}
æŒ‡çº¹1ï¼šhash(alertname+instance+job) = ABC123

å‘Šè­¦2ï¼š{alertname="HighCPU", instance="web-01", job="node"}  
æŒ‡çº¹2ï¼šhash(alertname+instance+job) = ABC123

æŒ‡çº¹ç›¸åŒ = é‡å¤å‘Šè­¦ â†’ å»é‡å¤„ç†
```

### 7.3 å»é‡é…ç½®ç­–ç•¥


**âš™ï¸ å½±å“å»é‡çš„é…ç½®**ï¼š

```yaml
# é€šè¿‡åˆ†ç»„é…ç½®å½±å“å»é‡
route:
  group_by: ['alertname', 'instance']
  # ç›¸åŒalertnameå’Œinstanceçš„å‘Šè­¦ä¼šè¢«åˆ†ç»„ï¼Œ
  # ä»è€Œå‡å°‘é‡å¤é€šçŸ¥

# æ—¶é—´çª—å£è®¾ç½®
group_wait: 30s      # ç­‰å¾…æœŸå†…çš„ç›¸åŒå‘Šè­¦ä¼šè¢«åˆå¹¶
group_interval: 5m   # é‡å¤å‘é€é—´éš”
repeat_interval: 4h  # æŒç»­å‘Šè­¦çš„é‡å¤æé†’é—´éš”
```

**ğŸ¯ å»é‡ç²’åº¦æ§åˆ¶**ï¼š

```yaml
# ç»†ç²’åº¦å»é‡ï¼šæŒ‰å®ä¾‹åˆ†ç»„
group_by: ['alertname', 'instance', 'device']
# æ•ˆæœï¼šä¸åŒè®¾å¤‡çš„ç›¸åŒç±»å‹å‘Šè­¦åˆ†åˆ«å¤„ç†

# ç²—ç²’åº¦å»é‡ï¼šåªæŒ‰å‘Šè­¦ååˆ†ç»„  
group_by: ['alertname']
# æ•ˆæœï¼šç›¸åŒç±»å‹çš„å‘Šè­¦éƒ½åˆå¹¶åœ¨ä¸€èµ·

# ä¸­ç­‰ç²’åº¦å»é‡ï¼šæŒ‰æœåŠ¡åˆ†ç»„
group_by: ['alertname', 'service']
# æ•ˆæœï¼šç›¸åŒæœåŠ¡çš„ç›¸åŒå‘Šè­¦åˆå¹¶
```

### 7.4 å»é‡æ•ˆæœç›‘æ§


**ğŸ“Š å»é‡æ•ˆæœè¯„ä¼°**ï¼š

```yaml
# åœ¨Prometheusä¸­æŸ¥è¯¢å»é‡æ•ˆæœ
# å‘Šè­¦æ€»æ•°
alertmanager_alerts_total

# åˆ†ç»„æ•°é‡
alertmanager_notification_requests_total

# å»é‡ç‡è®¡ç®—
(1 - alertmanager_notification_requests_total / alertmanager_alerts_total) * 100
```

**ğŸ”§ å»é‡ä¼˜åŒ–å»ºè®®**ï¼š

```
ä¼˜åŒ–ç­–ç•¥ï¼š
1. ğŸ“ åˆç†è®¾ç½®åˆ†ç»„æ ‡ç­¾
   â€¢ ç›¸å…³é—®é¢˜å½’ä¸ºä¸€ç»„
   â€¢ é¿å…åˆ†ç»„è¿‡ç»†æˆ–è¿‡ç²—

2. â° è°ƒæ•´æ—¶é—´å‚æ•°
   â€¢ group_wait: å¹³è¡¡åŠæ—¶æ€§å’Œåˆå¹¶æ•ˆæœ
   â€¢ repeat_interval: é¿å…è¿‡åº¦æ‰“æ‰°

3. ğŸ¯ æ ‡ç­¾æ ‡å‡†åŒ–
   â€¢ ç»Ÿä¸€å‘Šè­¦æ ‡ç­¾è§„èŒƒ
   â€¢ é¿å…å› æ ‡ç­¾ä¸ä¸€è‡´å¯¼è‡´çš„å»é‡å¤±æ•ˆ

4. ğŸ“ˆ ç›‘æ§å»é‡æ•ˆæœ
   â€¢ å®šæœŸæ£€æŸ¥å‘Šè­¦åˆå¹¶æƒ…å†µ
   â€¢ æ ¹æ®å®é™…æ•ˆæœè°ƒæ•´ç­–ç•¥
```

---

## 8. ğŸ’¼ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 8.1 å°å‹å›¢é˜Ÿé…ç½®æ¡ˆä¾‹


**ğŸ¢ åœºæ™¯æè¿°**ï¼š
ä¸€ä¸ª20äººçš„åˆ›ä¸šå…¬å¸ï¼Œæœ‰å¼€å‘ã€è¿ç»´ã€äº§å“ä¸‰ä¸ªå›¢é˜Ÿï¼Œç³»ç»Ÿç›¸å¯¹ç®€å•ã€‚

```yaml
# å°å‹å›¢é˜Ÿçš„alertmanager.yml
global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@startup.com'

route:
  receiver: 'default'
  group_by: ['alertname']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 2h
  
  routes:
    # ç”Ÿäº§ç¯å¢ƒä¸¥é‡å‘Šè­¦
    - match:
        severity: critical
        environment: production
      receiver: 'emergency-team'
      group_wait: 10s
      repeat_interval: 30m
      
    # æ•°æ®åº“ç›¸å…³å‘Šè­¦
    - match:
        service: database
      receiver: 'dev-and-ops'
      
    # å¼€å‘ç¯å¢ƒå‘Šè­¦ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
    - match:
        environment: development
      receiver: 'dev-team'
      group_interval: 30m
      repeat_interval: 8h

receivers:
  - name: 'default'
    email_configs:
      - to: 'team@startup.com'
        
  - name: 'emergency-team'
    email_configs:
      - to: 'emergency@startup.com'
    webhook_configs:
      - url: 'https://hooks.slack.com/your-emergency-channel'
        
  - name: 'dev-and-ops'
    email_configs:
      - to: 'dev@startup.com,ops@startup.com'
      
  - name: 'dev-team'
    email_configs:
      - to: 'dev@startup.com'
```

### 8.2 ä¸­å‹ä¼ä¸šé…ç½®æ¡ˆä¾‹


**ğŸ­ åœºæ™¯æè¿°**ï¼š
ä¸€ä¸ª200äººçš„ä¸­å‹äº’è”ç½‘å…¬å¸ï¼Œæœ‰å¤šä¸ªä¸šåŠ¡çº¿ï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ã€‚

```yaml
# ä¸­å‹ä¼ä¸šçš„alertmanager.yml
global:
  smtp_smarthost: 'internal-smtp.company.com:25'
  smtp_from: 'monitoring@company.com'

route:
  receiver: 'default-notifications'
  group_by: ['cluster', 'alertname']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  
  routes:
    # ä¸šåŠ¡çº¿Açš„å‘Šè­¦
    - match:
        team: business-a
      receiver: 'business-a-team'
      routes:
        - match:
            severity: critical
          receiver: 'business-a-oncall'
          group_wait: 10s
          repeat_interval: 15m
          
    # åŸºç¡€è®¾æ–½å‘Šè­¦
    - match:
        component: infrastructure
      receiver: 'sre-team'
      group_by: ['alertname', 'datacenter']
      routes:
        - match:
            alertname: DatacenterDown
          receiver: 'emergency-response'
          group_wait: 0s
          
    # å®‰å…¨ç›¸å…³å‘Šè­¦
    - match:
        category: security
      receiver: 'security-team'
      group_wait: 5s
      repeat_interval: 1h

inhibit_rules:
  # æœºæˆ¿æ•…éšœæ—¶æŠ‘åˆ¶æœåŠ¡å™¨å‘Šè­¦
  - source_match:
      alertname: DatacenterDown
    target_match:
      component: server
    equal: ['datacenter']
    
  # ç½‘ç»œæ•…éšœæ—¶æŠ‘åˆ¶åº”ç”¨å‘Šè­¦
  - source_match:
      component: network
      severity: critical
    target_match:
      component: application
    equal: ['cluster']

receivers:
  - name: 'default-notifications'
    email_configs:
      - to: 'ops-default@company.com'
        
  - name: 'business-a-team'
    email_configs:
      - to: 'business-a@company.com'
    slack_configs:
      - api_url: 'https://hooks.slack.com/business-a-alerts'
        channel: '#business-a-alerts'
        
  - name: 'sre-team'
    email_configs:
      - to: 'sre@company.com'
    webhook_configs:
      - url: 'http://ticket-system.company.com/api/alerts'
```

### 8.3 å¤§å‹ä¼ä¸šé…ç½®æ¡ˆä¾‹


**ğŸ›ï¸ åœºæ™¯æè¿°**ï¼š
ä¸€ä¸ª1000+äººçš„å¤§å‹ä¼ä¸šï¼Œå¤šåœ°éƒ¨ç½²ï¼Œå¤æ‚çš„ç»„ç»‡æ¶æ„å’Œä¸¥æ ¼çš„å‘Šè­¦åˆ†çº§åˆ¶åº¦ã€‚

```yaml
# å¤§å‹ä¼ä¸šçš„alertmanager.ymlï¼ˆç®€åŒ–ç‰ˆï¼‰
global:
  smtp_smarthost: 'relay.enterprise.com:25'
  smtp_from: 'monitoring-noreply@enterprise.com'

route:
  receiver: 'default-sink'
  group_by: ['region', 'cluster', 'alertname']
  group_wait: 45s
  group_interval: 8m
  repeat_interval: 6h
  
  routes:
    # P0çº§åˆ«å‘Šè­¦ï¼ˆå½±å“æ ¸å¿ƒä¸šåŠ¡ï¼‰
    - match:
        priority: P0
      receiver: 'p0-emergency-response'
      group_wait: 0s
      repeat_interval: 10m
      routes:
        - match:
            region: us-east
          receiver: 'p0-us-east-oncall'
        - match:
            region: eu-west
          receiver: 'p0-eu-west-oncall'
          
    # P1çº§åˆ«å‘Šè­¦ï¼ˆé‡è¦ä¸šåŠ¡å½±å“ï¼‰
    - match:
        priority: P1
      receiver: 'p1-response-team'
      group_wait: 5m
      repeat_interval: 30m
      
    # æŒ‰ä¸šåŠ¡å•å…ƒè·¯ç”±
    - match:
        business_unit: payments
      receiver: 'payments-team'
      group_by: ['service', 'alertname']
      
    - match:
        business_unit: user-management
      receiver: 'user-mgmt-team'
      
    # åŸºç¡€è®¾æ–½æŒ‰ç»„ä»¶è·¯ç”±
    - match:
        layer: infrastructure
      routes:
        - match:
            component: database
          receiver: 'dba-team'
        - match:
            component: network
          receiver: 'network-team'
        - match:
            component: storage
          receiver: 'storage-team'

# å¤æ‚çš„æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # åŒºåŸŸçº§æ•…éšœæŠ‘åˆ¶
  - source_match:
      alertname: RegionDown
    target_match_re:
      alertname: ^(ServiceDown|DatabaseUnreachable)$
    equal: ['region']
    
  # æ•°æ®ä¸­å¿ƒç”µåŠ›æ•…éšœ
  - source_match:
      alertname: PowerFailure
    target_match_re:
      component: ^(server|network|storage)$
    equal: ['datacenter']
    
  # ä¸»ä»åˆ‡æ¢æœŸé—´çš„æŠ‘åˆ¶
  - source_match:
      alertname: DatabaseFailover
      severity: critical
    target_match:
      component: database
      severity: warning
    equal: ['cluster', 'service']

receivers:
  - name: 'p0-emergency-response'
    email_configs:
      - to: 'p0-oncall@enterprise.com'
    pagerduty_configs:
      - service_key: 'your-pagerduty-service-key'
    webhook_configs:
      - url: 'http://incident-management.enterprise.com/api/p0'
        http_config:
          bearer_token: 'your-api-token'
```

### 8.4 é…ç½®æµ‹è¯•å’ŒéªŒè¯


**ğŸ§ª é…ç½®éªŒè¯æ–¹æ³•**ï¼š

```bash
# 1. è¯­æ³•æ£€æŸ¥
amtool config check alertmanager.yml

# 2. è·¯ç”±æµ‹è¯•
amtool config routes test \
  --config.file=alertmanager.yml \
  alertname=HighCPU severity=critical instance=web-01

# 3. æ¨¡æ‹Ÿå‘Šè­¦å‘é€
curl -X POST http://localhost:9093/api/v1/alerts \
  -H "Content-Type: application/json" \
  -d '[{
    "labels": {
      "alertname": "TestAlert",
      "severity": "warning",
      "instance": "test-server"
    },
    "annotations": {
      "summary": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å‘Šè­¦"
    }
  }]'
```

**ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•**ï¼š

```
é…ç½®å®Œæˆåæ£€æŸ¥é¡¹ï¼š
â–¡ è¯­æ³•éªŒè¯é€šè¿‡
â–¡ è·¯ç”±è§„åˆ™æµ‹è¯•æ­£ç¡®
â–¡ æ¥æ”¶å™¨é…ç½®éªŒè¯
â–¡ é‚®ä»¶å‘é€æµ‹è¯•æˆåŠŸ
â–¡ Webhookå“åº”æ­£å¸¸
â–¡ æŠ‘åˆ¶è§„åˆ™ç”Ÿæ•ˆ
â–¡ é™é»˜åŠŸèƒ½æ­£å¸¸
â–¡ æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
â–¡ æ—¥å¿—æ²¡æœ‰é”™è¯¯
â–¡ å›¢é˜Ÿæˆå‘˜ç¡®è®¤æ”¶åˆ°æµ‹è¯•å‘Šè­¦
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ å‘Šè­¦è·¯ç”±ï¼šæ™ºèƒ½é‚®å±€åˆ†æ‹£ç³»ç»Ÿï¼Œæ ¹æ®å‘Šè­¦ç‰¹å¾åˆ†å‘ç»™ä¸åŒæ¥æ”¶å™¨
ğŸ”¸ è·¯ç”±é…ç½®æ ‘ï¼šæ ‘å½¢ç»“æ„çš„åŒ¹é…è§„åˆ™ï¼Œä»æ ¹èŠ‚ç‚¹å‘ä¸‹åŒ¹é…
ğŸ”¸ å‘Šè­¦åˆ†ç»„ï¼šç›¸å…³å‘Šè­¦åˆå¹¶å‘é€ï¼Œå‡å°‘å‘Šè­¦é£æš´
ğŸ”¸ å‘Šè­¦æŠ‘åˆ¶ï¼šæ ¹æœ¬åŸå› å‘Šè­¦ä¼šæŠ‘åˆ¶è¡ç”Ÿé—®é¢˜å‘Šè­¦
ğŸ”¸ é™é»˜ç®¡ç†ï¼šä¸´æ—¶å±è”½å·²çŸ¥é—®é¢˜æˆ–ç»´æŠ¤æœŸé—´çš„å‘Šè­¦
ğŸ”¸ æ¥æ”¶å™¨é…ç½®ï¼šå®šä¹‰å…·ä½“çš„é€šçŸ¥æ¸ é“å’Œæ ¼å¼
ğŸ”¸ å»é‡æœºåˆ¶ï¼šé¿å…ç›¸åŒå‘Šè­¦é‡å¤å‘é€
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è·¯ç”±å†³ç­–çš„æ ¸å¿ƒé€»è¾‘**ï¼š
```
è·¯ç”±åŒ¹é…åŸåˆ™ï¼š
1. ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡åŒ¹é…
2. ç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™ç”Ÿæ•ˆ
3. å¯ä»¥é€šè¿‡continueå‚æ•°ç»§ç»­åŒ¹é…
4. æ²¡æœ‰åŒ¹é…çš„å‘Šè­¦èµ°é»˜è®¤è·¯ç”±

æ—¶é—´å‚æ•°çš„å¹³è¡¡ï¼š
â€¢ group_wait: å¹³è¡¡åŠæ—¶æ€§å’Œåˆå¹¶æ•ˆæœ
â€¢ group_interval: æ§åˆ¶é‡å¤å‘é€é¢‘ç‡  
â€¢ repeat_interval: é¿å…è¿‡åº¦æ‰“æ‰°
```

**ğŸ”¹ åˆ†ç»„ç­–ç•¥çš„è®¾è®¡æ€è·¯**ï¼š
```
åˆ†ç»„çš„ç›®æ ‡ï¼š
â€¢ ç›¸å…³é—®é¢˜åˆå¹¶å¤„ç†
â€¢ å‡å°‘å‘Šè­¦å™ªéŸ³
â€¢ æé«˜å¤„ç†æ•ˆç‡
â€¢ ä¿æŒä¿¡æ¯å®Œæ•´æ€§

åˆ†ç»„æ ‡ç­¾é€‰æ‹©ï¼š
â€¢ ä¸šåŠ¡ç›¸å…³æ€§ä¼˜å…ˆ
â€¢ å¤„ç†å›¢é˜Ÿä¸€è‡´æ€§
â€¢ å½±å“èŒƒå›´ç›¸ä¼¼æ€§
â€¢ ç´§æ€¥ç¨‹åº¦ç›¸åŒæ€§
```

**ğŸ”¹ æŠ‘åˆ¶è§„åˆ™çš„è®¾è®¡åŸåˆ™**ï¼š
```
æŠ‘åˆ¶é€»è¾‘ï¼š
â€¢ è¯†åˆ«å› æœå…³ç³»
â€¢ æŠ‘åˆ¶è¡ç”Ÿé—®é¢˜
â€¢ ä¿ç•™æ ¹æœ¬åŸå› å‘Šè­¦
â€¢ é¿å…è¯¯æ€é‡è¦å‘Šè­¦

æŠ‘åˆ¶èŒƒå›´æ§åˆ¶ï¼š
â€¢ equalå‚æ•°ç²¾ç¡®åŒ¹é…
â€¢ é¿å…æŠ‘åˆ¶èŒƒå›´è¿‡å¤§
â€¢ è€ƒè™‘æ—¶é—´å› ç´ 
â€¢ å®šæœŸå®¡æŸ¥è§„åˆ™æœ‰æ•ˆæ€§
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ é…ç½®ç­–ç•¥å»ºè®®**ï¼š
```
å°å‹å›¢é˜Ÿï¼š
â€¢ ç®€åŒ–è·¯ç”±ç»“æ„
â€¢ å…³æ³¨æ ¸å¿ƒä¸šåŠ¡å‘Šè­¦
â€¢ ä½¿ç”¨åŸºç¡€é€šçŸ¥æ¸ é“
â€¢ å‡å°‘å¤æ‚è§„åˆ™

ä¸­å‹ä¼ä¸šï¼š
â€¢ æŒ‰ä¸šåŠ¡çº¿åˆ’åˆ†è·¯ç”±
â€¢ å»ºç«‹å‘Šè­¦åˆ†çº§åˆ¶åº¦
â€¢ é…ç½®å¤šç§é€šçŸ¥æ¸ é“
â€¢ å®æ–½åŸºæœ¬æŠ‘åˆ¶è§„åˆ™

å¤§å‹ä¼ä¸šï¼š
â€¢ å¤æ‚çš„è·¯ç”±æ ‘ç»“æ„
â€¢ ä¸¥æ ¼çš„å‘Šè­¦åˆ†çº§
â€¢ å¤šåœ°åŸŸå¤šå›¢é˜Ÿæ”¯æŒ
â€¢ å®Œå–„çš„æŠ‘åˆ¶å’Œé™é»˜è§„åˆ™
```

**ğŸ› ï¸ è¿ç»´æœ€ä½³å®è·µ**ï¼š
```
é…ç½®ç®¡ç†ï¼š
â€¢ ç‰ˆæœ¬æ§åˆ¶å‘Šè­¦é…ç½®
â€¢ å»ºç«‹é…ç½®å˜æ›´æµç¨‹
â€¢ å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
â€¢ æ–‡æ¡£åŒ–é…ç½®è§„åˆ™

æ€§èƒ½ä¼˜åŒ–ï¼š
â€¢ ç›‘æ§Alertmanageræ€§èƒ½
â€¢ ä¼˜åŒ–è·¯ç”±åŒ¹é…æ•ˆç‡
â€¢ åˆç†è®¾ç½®æ—¶é—´å‚æ•°
â€¢ å®šæœŸæ¸…ç†æ— æ•ˆè§„åˆ™

æ•…éšœå¤„ç†ï¼š
â€¢ å»ºç«‹å‘Šè­¦é…ç½®æµ‹è¯•æµç¨‹
â€¢ ç›‘æ§é€šçŸ¥æ¸ é“å¯ç”¨æ€§
â€¢ å‡†å¤‡åº”æ€¥é€šçŸ¥æ–¹æ¡ˆ
â€¢ å®šæœŸæ¼”ç»ƒå‘Šè­¦æµç¨‹
```

**ğŸ¯ å­¦ä¹ å»ºè®®**ï¼š
```
å­¦ä¹ è·¯å¾„ï¼š
1. ç†è§£åŸºæœ¬æ¦‚å¿µå’Œç»„ä»¶å…³ç³»
2. æŒæ¡åŸºç¡€é…ç½®è¯­æ³•
3. å®è·µç®€å•çš„è·¯ç”±è§„åˆ™
4. å­¦ä¹ é«˜çº§åŠŸèƒ½ï¼ˆæŠ‘åˆ¶ã€é™é»˜ï¼‰
5. è®¾è®¡å¤æ‚åœºæ™¯çš„é…ç½®æ–¹æ¡ˆ

å®è·µå»ºè®®ï¼š
â€¢ ä»ç®€å•é…ç½®å¼€å§‹
â€¢ é€æ­¥å¢åŠ å¤æ‚åº¦
â€¢ å¤šåšé…ç½®æµ‹è¯•
â€¢ å…³æ³¨å®é™…ä½¿ç”¨æ•ˆæœ
â€¢ æŒç»­ä¼˜åŒ–é…ç½®
```

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ å‘Šè­¦æ”¶ä¸åˆ°æ€ä¹ˆåŠï¼Ÿ**
```
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥Prometheusæ˜¯å¦äº§ç”Ÿå‘Šè­¦
2. ç¡®è®¤Alertmanageræ¥æ”¶åˆ°å‘Šè­¦
3. éªŒè¯è·¯ç”±è§„åˆ™åŒ¹é…
4. æ£€æŸ¥æ¥æ”¶å™¨é…ç½®
5. ç¡®è®¤é€šçŸ¥æ¸ é“å¯ç”¨æ€§
6. æŸ¥çœ‹Alertmanageræ—¥å¿—
```

**â“ å‘Šè­¦å¤ªå¤šå¤ªé¢‘ç¹æ€ä¹ˆåŠï¼Ÿ**
```
ä¼˜åŒ–ç­–ç•¥ï¼š
1. è°ƒæ•´å‘Šè­¦é˜ˆå€¼ï¼Œå‡å°‘è¯¯æŠ¥
2. ä¼˜åŒ–åˆ†ç»„ç­–ç•¥ï¼Œåˆå¹¶ç›¸å…³å‘Šè­¦
3. å¢åŠ æŠ‘åˆ¶è§„åˆ™ï¼Œå‡å°‘è¡ç”Ÿå‘Šè­¦
4. å»¶é•¿repeat_intervalï¼Œå‡å°‘é‡å¤é€šçŸ¥
5. ä½¿ç”¨é™é»˜åŠŸèƒ½å¤„ç†å·²çŸ¥é—®é¢˜
```

**â“ é‡è¦å‘Šè­¦è¢«æ¼æ‰æ€ä¹ˆåŠï¼Ÿ**
```
é¢„é˜²æªæ–½ï¼š
1. ä¸ºå…³é”®å‘Šè­¦è®¾ç½®ä¸“é—¨è·¯ç”±
2. é…ç½®å¤šç§é€šçŸ¥æ¸ é“
3. è®¾ç½®å‘Šè­¦å‡çº§æœºåˆ¶
4. å®šæœŸæ£€æŸ¥æŠ‘åˆ¶è§„åˆ™
5. å»ºç«‹å‘Šè­¦å“åº”ç›‘æ§
```

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- å‘Šè­¦è·¯ç”±åƒæ™ºèƒ½é‚®å±€ï¼Œæ ¹æ®åœ°å€åˆ†æ‹£é‚®ä»¶
- åˆ†ç»„ç­–ç•¥è¦å¹³è¡¡åŠæ—¶æ€§å’Œä¿¡æ¯æ•´åˆ
- æŠ‘åˆ¶è§„åˆ™å¤„ç†å› æœå…³ç³»ï¼Œé¿å…å‘Šè­¦é£æš´
- é™é»˜åŠŸèƒ½æ˜¯ä¸´æ—¶å‹¿æ‰°æ¨¡å¼ï¼Œç”¨äºç»´æŠ¤å’Œå·²çŸ¥é—®é¢˜
- æ¥æ”¶å™¨æ˜¯æœ€ç»ˆçš„é€šçŸ¥å‡ºå£ï¼Œè¦ä¿è¯å¯é æ€§
- é…ç½®è¦ä»ç®€å•å¼€å§‹ï¼Œé€æ­¥å®Œå–„å’Œä¼˜åŒ–

**æ ¸å¿ƒç†å¿µ**ï¼šå¥½çš„å‘Šè­¦è·¯ç”±é…ç½®èƒ½å¤Ÿåœ¨æ­£ç¡®çš„æ—¶é—´ï¼Œå°†æ­£ç¡®çš„ä¿¡æ¯ï¼Œå‘é€ç»™æ­£ç¡®çš„äººï¼Œè®©å›¢é˜Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°å“åº”å’Œå¤„ç†é—®é¢˜ï¼