---
title: 4ã€alertmanager.ymlå‘Šè­¦ç®¡ç†å™¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [AlertmanageråŸºæœ¬æ¦‚å¿µ](#1-AlertmanageråŸºæœ¬æ¦‚å¿µ)
2. [é…ç½®æ–‡ä»¶ç»“æ„è§£æ](#2-é…ç½®æ–‡ä»¶ç»“æ„è§£æ)
3. [å…¨å±€é…ç½®è¯¦è§£](#3-å…¨å±€é…ç½®è¯¦è§£)
4. [è·¯ç”±é…ç½®æ ¸å¿ƒ](#4-è·¯ç”±é…ç½®æ ¸å¿ƒ)
5. [æ¥æ”¶å™¨é…ç½®å®æˆ˜](#5-æ¥æ”¶å™¨é…ç½®å®æˆ˜)
6. [å‘Šè­¦æŠ‘åˆ¶æœºåˆ¶](#6-å‘Šè­¦æŠ‘åˆ¶æœºåˆ¶)
7. [æ¨¡æ¿é…ç½®ä¸è‡ªå®šä¹‰](#7-æ¨¡æ¿é…ç½®ä¸è‡ªå®šä¹‰)
8. [å®Œæ•´é…ç½®ç¤ºä¾‹](#8-å®Œæ•´é…ç½®ç¤ºä¾‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”” AlertmanageråŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Alertmanager


**ğŸ”¸ ç®€å•ç†è§£**
æŠŠAlertmanageræƒ³è±¡æˆä¸€ä¸ª**æ™ºèƒ½çš„æ¶ˆæ¯ä¸­è½¬ç«™**ã€‚å½“Prometheuså‘ç°é—®é¢˜æ—¶ï¼Œå®ƒä¸ä¼šç›´æ¥ç»™ä½ å‘æ¶ˆæ¯ï¼Œè€Œæ˜¯æŠŠå‘Šè­¦ä¿¡æ¯äº¤ç»™Alertmanagerï¼Œç”±å®ƒæ¥å†³å®šï¼š
- è¿™ä¸ªå‘Šè­¦è¯¥å‘ç»™è°ï¼Ÿ
- ä»€ä¹ˆæ—¶å€™å‘ï¼Ÿ
- é€šè¿‡ä»€ä¹ˆæ–¹å¼å‘ï¼Ÿï¼ˆé‚®ä»¶ã€å¾®ä¿¡ã€çŸ­ä¿¡ç­‰ï¼‰
- å¦‚ä½•é¿å…é‡å¤å‘é€ï¼Ÿ

**ğŸ¯ æ ¸å¿ƒä½œç”¨**
```
Prometheusç›‘æ§ â†’ å‘ç°é—®é¢˜ â†’ å‘é€å‘Šè­¦ â†’ Alertmanageræ¥æ”¶
                                        â†“
                               æ™ºèƒ½å¤„ç†å’Œè·¯ç”±
                                        â†“
                            å‘é€ç»™å¯¹åº”çš„äººæˆ–å›¢é˜Ÿ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Alertmanager


**ğŸ’¡ è§£å†³çš„é—®é¢˜**
- **å‘Šè­¦æ³›æ»¥**ï¼šé¿å…æ”¶åˆ°å¤§é‡é‡å¤çš„å‘Šè­¦æ¶ˆæ¯
- **è·¯ç”±åˆ†å‘**ï¼šä¸åŒç±»å‹çš„é—®é¢˜å‘ç»™ä¸åŒçš„è´Ÿè´£äºº
- **æ—¶é—´æ§åˆ¶**ï¼šå·¥ä½œæ—¶é—´å‘é‚®ä»¶ï¼Œç´§æ€¥æƒ…å†µå‘çŸ­ä¿¡
- **åˆ†ç»„èšåˆ**ï¼šç›¸å…³çš„å¤šä¸ªå‘Šè­¦åˆå¹¶æˆä¸€æ¡æ¶ˆæ¯

**ğŸ“Š å·¥ä½œæµç¨‹å›¾ç¤º**
```
ç›‘æ§ç³»ç»Ÿå‘ç°é—®é¢˜
        â†“
   Alertmanageræ¥æ”¶
        â†“
    åº”ç”¨è·¯ç”±è§„åˆ™
        â†“
   é€‰æ‹©åˆé€‚çš„æ¥æ”¶å™¨
        â†“
    å‘é€é€šçŸ¥æ¶ˆæ¯
```

### 1.3 é…ç½®æ–‡ä»¶çš„é‡è¦æ€§


`alertmanager.yml`æ˜¯Alertmanagerçš„**å¤§è„‘**ï¼Œå®ƒå†³å®šäº†ï¼š
- **è°æ¥å¤„ç†**ï¼šä¸åŒå‘Šè­¦å‘ç»™ä¸åŒäºº
- **å¦‚ä½•å¤„ç†**ï¼šé‚®ä»¶ã€çŸ­ä¿¡ã€è¿˜æ˜¯å…¶ä»–æ–¹å¼
- **ä½•æ—¶å¤„ç†**ï¼šç«‹å³å‘é€è¿˜æ˜¯å»¶è¿Ÿåˆ†ç»„
- **æ€ä¹ˆå¤„ç†**ï¼šæ¶ˆæ¯æ ¼å¼ã€æ¨¡æ¿æ ·å¼

---

## 2. ğŸ“‹ é…ç½®æ–‡ä»¶ç»“æ„è§£æ


### 2.1 æ•´ä½“ç»“æ„æ¦‚è§ˆ


```yaml
# alertmanager.yml åŸºæœ¬ç»“æ„
global:           # å…¨å±€é…ç½®ï¼ˆé‚®ç®±æœåŠ¡å™¨ç­‰ï¼‰
  smtp_smarthost: 'localhost:587'
  
route:            # è·¯ç”±è§„åˆ™ï¼ˆå‘Šè­¦å¦‚ä½•åˆ†å‘ï¼‰
  group_by: ['alertname']
  routes:
    - match:
        service: database
      receiver: db-team
      
receivers:        # æ¥æ”¶å™¨ï¼ˆå‘é€æ–¹å¼å’Œç›®æ ‡ï¼‰
  - name: 'default'
    email_configs:
      - to: 'admin@company.com'
        
inhibit_rules:    # æŠ‘åˆ¶è§„åˆ™ï¼ˆé¿å…é‡å¤å‘Šè­¦ï¼‰
  - source_match:
      severity: critical
      
templates:        # æ¨¡æ¿ï¼ˆè‡ªå®šä¹‰æ¶ˆæ¯æ ¼å¼ï¼‰
  - '/etc/templates/*.tmpl'
```

### 2.2 å„éƒ¨åˆ†å…³ç³»å›¾ç¤º


```
å…¨å±€é…ç½®(global)
     â†“
è·¯ç”±è§„åˆ™(route) â†â†’ æ¥æ”¶å™¨(receivers)
     â†“                   â†‘
å­è·¯ç”±(routes)            â†‘
     â†“                   â†‘
åŒ¹é…æ¡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     
æŠ‘åˆ¶è§„åˆ™(inhibit_rules) â†’ å‡å°‘é‡å¤å‘Šè­¦
æ¨¡æ¿é…ç½®(templates) â†’ ç¾åŒ–æ¶ˆæ¯æ ¼å¼
```

---

## 3. ğŸŒ å…¨å±€é…ç½®è¯¦è§£


### 3.1 é‚®ä»¶æœåŠ¡å™¨é…ç½®


**ğŸ”¸ åŸºæœ¬é‚®ä»¶é…ç½®**
```yaml
global:
  # SMTPæœåŠ¡å™¨åœ°å€å’Œç«¯å£
  smtp_smarthost: 'smtp.qq.com:587'
  
  # å‘ä»¶äººé‚®ç®±
  smtp_from: 'monitor@company.com'
  
  # é‚®ç®±ç”¨æˆ·åï¼ˆé€šå¸¸å°±æ˜¯é‚®ç®±åœ°å€ï¼‰
  smtp_auth_username: 'monitor@company.com'
  
  # é‚®ç®±å¯†ç æˆ–æˆæƒç 
  smtp_auth_password: 'your_password'
  
  # æ˜¯å¦éœ€è¦TLSåŠ å¯†
  smtp_require_tls: true
```

**ğŸ’¡ å‚æ•°è¯´æ˜**
- **smtp_smarthost**ï¼šä½ çš„é‚®ç®±æœåŠ¡å•†çš„SMTPæœåŠ¡å™¨
  - QQé‚®ç®±ï¼š`smtp.qq.com:587`
  - 163é‚®ç®±ï¼š`smtp.163.com:587`
  - ä¼ä¸šé‚®ç®±ï¼šè¯¢é—®ITéƒ¨é—¨
- **smtp_from**ï¼šå‘Šè­¦é‚®ä»¶çš„å‘ä»¶äººåœ°å€
- **smtp_auth_username/password**ï¼šé‚®ç®±ç™»å½•å‡­æ®

### 3.2 å…¶ä»–å…¨å±€é…ç½®


```yaml
global:
  # é»˜è®¤çš„è§£æè¶…æ—¶æ—¶é—´
  resolve_timeout: 5m
  
  # HTTPå®¢æˆ·ç«¯é…ç½®
  http_config:
    tls_config:
      insecure_skip_verify: false
  
  # Slackå…¨å±€é…ç½®
  slack_api_url: 'https://hooks.slack.com/services/...'
  
  # å¾®ä¿¡å…¨å±€é…ç½®
  wechat_api_url: 'https://qyapi.weixin.qq.com/cgi-bin/'
  wechat_api_corp_id: 'your_corp_id'
```

---

## 4. ğŸ›£ï¸ è·¯ç”±é…ç½®æ ¸å¿ƒ


### 4.1 è·¯ç”±çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯è·¯ç”±**
è·¯ç”±å°±åƒæ˜¯**é‚®å±€çš„åˆ†æ‹£å‘˜**ï¼Œå®ƒæ ¹æ®å‘Šè­¦çš„æ ‡ç­¾ï¼ˆæ¯”å¦‚æœåŠ¡åç§°ã€ä¸¥é‡ç¨‹åº¦ï¼‰æ¥å†³å®šè¿™ä¸ªå‘Šè­¦åº”è¯¥å‘ç»™è°ã€‚

**ğŸ“Š è·¯ç”±å†³ç­–æµç¨‹**
```
æ”¶åˆ°å‘Šè­¦
    â†“
æ£€æŸ¥æ ‡ç­¾ä¿¡æ¯
    â†“
åŒ¹é…è·¯ç”±è§„åˆ™
    â†“
é€‰æ‹©æ¥æ”¶å™¨
    â†“
å‘é€é€šçŸ¥
```

### 4.2 åŸºç¡€è·¯ç”±é…ç½®


```yaml
route:
  # åˆ†ç»„æ¡ä»¶ï¼šç›¸åŒæ ‡ç­¾çš„å‘Šè­¦ä¼šè¢«åˆ†åˆ°ä¸€ç»„
  group_by: ['alertname', 'cluster', 'service']
  
  # åˆ†ç»„ç­‰å¾…æ—¶é—´ï¼šæ”¶åˆ°ç¬¬ä¸€ä¸ªå‘Šè­¦åç­‰å¾…10ç§’ï¼Œçœ‹æ˜¯å¦è¿˜æœ‰ç›¸å…³å‘Šè­¦
  group_wait: 10s
  
  # åˆ†ç»„é—´éš”ï¼šåŒä¸€ç»„å‘Šè­¦æœ€å¤šæ¯5åˆ†é’Ÿå‘é€ä¸€æ¬¡
  group_interval: 5m
  
  # é‡å¤é—´éš”ï¼šç›¸åŒå‘Šè­¦æœ€å¤šæ¯12å°æ—¶é‡å¤ä¸€æ¬¡
  repeat_interval: 12h
  
  # é»˜è®¤æ¥æ”¶å™¨ï¼šå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å…·ä½“è·¯ç”±ï¼Œå°±ç”¨è¿™ä¸ª
  receiver: 'default-team'
```

**ğŸ’¡ æ—¶é—´å‚æ•°è¯¦è§£**
- **group_wait**ï¼šåƒæ˜¯"ç­‰ç­‰çœ‹è¿˜æœ‰æ²¡æœ‰ä¸€èµ·çš„"
- **group_interval**ï¼šåƒæ˜¯"åˆšå‘è¿‡æ¶ˆæ¯ï¼Œå†ç­‰ç­‰å†å‘"
- **repeat_interval**ï¼šåƒæ˜¯"è¿™ä¸ªé—®é¢˜æé†’è¿‡äº†ï¼Œè¿‡ä¸€æ®µæ—¶é—´å†æé†’"

### 4.3 å­è·¯ç”±é…ç½®


```yaml
route:
  group_by: ['alertname']
  receiver: 'default-team'
  
  # å­è·¯ç”±ï¼šæ›´å…·ä½“çš„åŒ¹é…è§„åˆ™
  routes:
    # æ•°æ®åº“ç›¸å…³å‘Šè­¦
    - match:
        service: database
      receiver: 'db-team'
      group_wait: 5s
      
    # ä¸¥é‡å‘Šè­¦ç«‹å³å‘é€
    - match:
        severity: critical
      receiver: 'oncall-team'
      group_wait: 1s
      repeat_interval: 1h
      
    # æ­£åˆ™åŒ¹é…ï¼šæ‰€æœ‰ä»¥webå¼€å¤´çš„æœåŠ¡
    - match_re:
        service: ^web.*
      receiver: 'web-team'
```

### 4.4 è·¯ç”±åŒ¹é…é€»è¾‘


**ğŸ”¸ åŒ¹é…ä¼˜å…ˆçº§**
```
1. ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ£€æŸ¥routesä¸­çš„è§„åˆ™
2. ç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™ç”Ÿæ•ˆ
3. å¦‚æœéƒ½ä¸åŒ¹é…ï¼Œä½¿ç”¨é»˜è®¤receiver
```

**ğŸ¯ åŒ¹é…æ–¹å¼å¯¹æ¯”**

| åŒ¹é…æ–¹å¼ | è¯­æ³• | ç¤ºä¾‹ | è¯´æ˜ |
|---------|------|------|------|
| **ç²¾ç¡®åŒ¹é…** | `match:` | `service: api` | æ ‡ç­¾å€¼å¿…é¡»å®Œå…¨ç›¸ç­‰ |
| **æ­£åˆ™åŒ¹é…** | `match_re:` | `service: ^web.*` | æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ |

---

## 5. ğŸ“® æ¥æ”¶å™¨é…ç½®å®æˆ˜


### 5.1 æ¥æ”¶å™¨çš„æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ¥æ”¶å™¨**
æ¥æ”¶å™¨å°±æ˜¯**æ¶ˆæ¯çš„æœ€ç»ˆå»å¤„**ï¼Œå®šä¹‰äº†å‘Šè­¦ä¿¡æ¯è¦é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼ˆé‚®ä»¶ã€å¾®ä¿¡ã€çŸ­ä¿¡ç­‰ï¼‰å‘é€ç»™è°ã€‚

### 5.2 é‚®ä»¶æ¥æ”¶å™¨é…ç½®


```yaml
receivers:
  - name: 'email-team'
    email_configs:
      # åŸºæœ¬é‚®ä»¶é…ç½®
      - to: 'dev@company.com,ops@company.com'
        from: 'alertmanager@company.com'
        subject: 'ğŸš¨ {{ .GroupLabels.alertname }} å‘Šè­¦'
        
        # é‚®ä»¶æ­£æ–‡
        body: |
          å‘Šè­¦è¯¦æƒ…ï¼š
          - å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}
          - ä¸¥é‡ç¨‹åº¦ï¼š{{ .GroupLabels.severity }}
          - å‘Šè­¦æ—¶é—´ï¼š{{ .Alerts | len }} ä¸ª
          
          {{ range .Alerts }}
          - å®ä¾‹ï¼š{{ .Labels.instance }}
          - æè¿°ï¼š{{ .Annotations.description }}
          {{ end }}
        
        # HTMLæ ¼å¼é‚®ä»¶
        html: |
          <h2>ğŸš¨ ç³»ç»Ÿå‘Šè­¦é€šçŸ¥</h2>
          <p><strong>å‘Šè­¦åç§°ï¼š</strong>{{ .GroupLabels.alertname }}</p>
          <table border="1">
            {{ range .Alerts }}
            <tr>
              <td>{{ .Labels.instance }}</td>
              <td>{{ .Annotations.description }}</td>
            </tr>
            {{ end }}
          </table>
```

### 5.3 Webhookæ¥æ”¶å™¨é…ç½®


```yaml
receivers:
  - name: 'webhook-team'
    webhook_configs:
      # å‘é€åˆ°è‡ªå®šä¹‰API
      - url: 'http://internal-api.company.com/alerts'
        
        # å‘é€æ–¹å¼
        send_resolved: true
        
        # HTTPå¤´ä¿¡æ¯
        http_config:
          basic_auth:
            username: 'alertmanager'
            password: 'secret'
```

### 5.4 å¤šç§é€šçŸ¥æ–¹å¼é…ç½®


```yaml
receivers:
  # è¿ç»´å›¢é˜Ÿï¼šé‚®ä»¶+Slack
  - name: 'ops-team'
    email_configs:
      - to: 'ops@company.com'
        subject: 'è¿ç»´å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/xxx'
        channel: '#ops-alerts'
        title: '{{ .GroupLabels.alertname }}'
        
  # å¼€å‘å›¢é˜Ÿï¼šåªå‘é‚®ä»¶
  - name: 'dev-team'
    email_configs:
      - to: 'dev@company.com'
        subject: 'å¼€å‘å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
```

### 5.5 å¾®ä¿¡ä¼ä¸šå·é…ç½®


```yaml
receivers:
  - name: 'wechat-team'
    wechat_configs:
      - corp_id: 'your_corp_id'
        api_secret: 'your_api_secret'
        to_user: '@all'
        agent_id: '1000001'
        
        message: |
          å‘Šè­¦åç§°ï¼š{{ .GroupLabels.alertname }}
          ä¸¥é‡ç¨‹åº¦ï¼š{{ .GroupLabels.severity }}
          {{ range .Alerts }}
          å®ä¾‹ï¼š{{ .Labels.instance }}
          {{ end }}
```

---

## 6. ğŸš« å‘Šè­¦æŠ‘åˆ¶æœºåˆ¶


### 6.1 ä»€ä¹ˆæ˜¯å‘Šè­¦æŠ‘åˆ¶


**ğŸ”¸ ç®€å•ç†è§£**
å‘Šè­¦æŠ‘åˆ¶å°±åƒæ˜¯**æ™ºèƒ½è¿‡æ»¤å™¨**ã€‚æ¯”å¦‚ï¼Œå½“æœåŠ¡å™¨å®•æœºæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå‡ åä¸ªç›¸å…³çš„å‘Šè­¦ï¼ˆCPUå‘Šè­¦ã€å†…å­˜å‘Šè­¦ã€ç½‘ç»œå‘Šè­¦ç­‰ï¼‰ï¼Œä½†å…¶å®æ ¹æœ¬åŸå› å°±æ˜¯æœåŠ¡å™¨å®•æœºï¼Œæ‰€ä»¥åªéœ€è¦å‘é€"æœåŠ¡å™¨å®•æœº"è¿™ä¸€ä¸ªå‘Šè­¦å³å¯ã€‚

**ğŸ’¡ æŠ‘åˆ¶çš„å¥½å¤„**
- å‡å°‘å‘Šè­¦æ•°é‡ï¼Œé¿å…ä¿¡æ¯è¿‡è½½
- çªå‡ºæ ¹æœ¬åŸå› ï¼Œä¾¿äºå¿«é€Ÿå®šä½é—®é¢˜
- æé«˜å‘Šè­¦çš„æœ‰æ•ˆæ€§

### 6.2 æŠ‘åˆ¶è§„åˆ™é…ç½®


```yaml
inhibit_rules:
  # æœåŠ¡å™¨å®•æœºæ—¶ï¼ŒæŠ‘åˆ¶è¯¥æœåŠ¡å™¨çš„å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: 'ServerDown'
    target_match:
      instance: '.*'
    target_match_re:
      alertname: '(CPUHigh|MemoryHigh|DiskSpaceLow)'
    equal: ['instance']
    
  # ä¸¥é‡å‘Šè­¦æŠ‘åˆ¶ä¸€èˆ¬å‘Šè­¦
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['service', 'instance']
```

**ğŸ”¸ å‚æ•°è¯´æ˜**
- **source_match**ï¼šæŠ‘åˆ¶æºï¼ˆä¸»è¦å‘Šè­¦ï¼‰çš„åŒ¹é…æ¡ä»¶
- **target_match**ï¼šè¢«æŠ‘åˆ¶ç›®æ ‡çš„åŒ¹é…æ¡ä»¶
- **equal**ï¼šå¿…é¡»ç›¸ç­‰çš„æ ‡ç­¾ï¼ˆç¡®ä¿æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼‰

### 6.3 æŠ‘åˆ¶è§„åˆ™ç¤ºä¾‹


```yaml
inhibit_rules:
  # æ•°æ®åº“ä¸»ä»åˆ‡æ¢æ—¶çš„æŠ‘åˆ¶
  - source_match:
      alertname: 'DatabaseFailover'
    target_match_re:
      alertname: '(DatabaseSlow|DatabaseConnections)'
    equal: ['cluster']
    
  # ç½‘ç»œæ•…éšœæ—¶çš„æŠ‘åˆ¶
  - source_match:
      alertname: 'NetworkDown'
    target_match_re:
      alertname: '(ServiceUnavailable|APITimeout)'
    equal: ['datacenter']
```

---

## 7. ğŸ“ æ¨¡æ¿é…ç½®ä¸è‡ªå®šä¹‰


### 7.1 æ¨¡æ¿çš„ä½œç”¨


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦æ¨¡æ¿**
é»˜è®¤çš„å‘Šè­¦æ¶ˆæ¯å¯èƒ½æ¯”è¾ƒç®€é™‹ï¼Œé€šè¿‡æ¨¡æ¿å¯ä»¥ï¼š
- ç¾åŒ–æ¶ˆæ¯æ ¼å¼
- æ·»åŠ æ›´å¤šæœ‰ç”¨ä¿¡æ¯
- ç»Ÿä¸€æ¶ˆæ¯é£æ ¼
- æ”¯æŒå¤šè¯­è¨€

### 7.2 æ¨¡æ¿æ–‡ä»¶é…ç½®


```yaml
# åœ¨alertmanager.ymlä¸­æŒ‡å®šæ¨¡æ¿æ–‡ä»¶ä½ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'
  - '/usr/local/share/alertmanager/templates/*.tmpl'
```

### 7.3 è‡ªå®šä¹‰æ¨¡æ¿ç¤ºä¾‹


**ğŸ“§ é‚®ä»¶æ¨¡æ¿æ–‡ä»¶ï¼ˆemail.tmplï¼‰**
```go
{{ define "email.subject" }}
[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }} ({{ .Alerts | len }})
{{ end }}

{{ define "email.html" }}
<html>
<head>
  <style>
    .critical { color: red; }
    .warning { color: orange; }
    .info { color: blue; }
  </style>
</head>
<body>
  <h2>ğŸ“Š ç³»ç»Ÿç›‘æ§å‘Šè­¦</h2>
  
  <h3>å‘Šè­¦æ¦‚è¦</h3>
  <ul>
    <li><strong>å‘Šè­¦åç§°ï¼š</strong>{{ .GroupLabels.alertname }}</li>
    <li><strong>å‘Šè­¦æ•°é‡ï¼š</strong>{{ .Alerts | len }}</li>
    <li><strong>å‘ç”Ÿæ—¶é—´ï¼š</strong>{{ (index .Alerts 0).StartsAt.Format "2006-01-02 15:04:05" }}</li>
  </ul>
  
  <h3>è¯¦ç»†ä¿¡æ¯</h3>
  <table border="1" cellpadding="5">
    <tr>
      <th>å®ä¾‹</th>
      <th>ä¸¥é‡ç¨‹åº¦</th>
      <th>æè¿°</th>
    </tr>
    {{ range .Alerts }}
    <tr>
      <td>{{ .Labels.instance }}</td>
      <td class="{{ .Labels.severity }}">{{ .Labels.severity }}</td>
      <td>{{ .Annotations.description }}</td>
    </tr>
    {{ end }}
  </table>
</body>
</html>
{{ end }}
```

### 7.4 åœ¨æ¥æ”¶å™¨ä¸­ä½¿ç”¨æ¨¡æ¿


```yaml
receivers:
  - name: 'custom-email'
    email_configs:
      - to: 'admin@company.com'
        subject: '{{ template "email.subject" . }}'
        html: '{{ template "email.html" . }}'
```

---

## 8. ğŸ“„ å®Œæ•´é…ç½®ç¤ºä¾‹


### 8.1 ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹


```yaml
# å…¨å±€é…ç½®
global:
  smtp_smarthost: 'smtp.company.com:587'
  smtp_from: 'alertmanager@company.com'
  smtp_auth_username: 'alertmanager@company.com'
  smtp_auth_password: 'your_password'
  smtp_require_tls: true
  resolve_timeout: 5m

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 12h
  receiver: 'default'
  
  routes:
    # ä¸¥é‡å‘Šè­¦ï¼šç«‹å³é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-team'
      group_wait: 1s
      repeat_interval: 1h
      
    # æ•°æ®åº“å‘Šè­¦ï¼šé€šçŸ¥DBAå›¢é˜Ÿ
    - match:
        service: database
      receiver: 'dba-team'
      group_by: ['alertname', 'instance']
      
    # WebæœåŠ¡å‘Šè­¦ï¼šé€šçŸ¥å¼€å‘å›¢é˜Ÿ
    - match_re:
        service: ^(api|web|frontend)$
      receiver: 'dev-team'
      
    # åŸºç¡€è®¾æ–½å‘Šè­¦ï¼šé€šçŸ¥è¿ç»´å›¢é˜Ÿ
    - match_re:
        alertname: ^(ServerDown|DiskSpaceLow|NetworkIssue)$
      receiver: 'ops-team'

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default'
    email_configs:
      - to: 'admin@company.com'
        subject: 'ç³»ç»Ÿå‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
        
  # ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-team'
    email_configs:
      - to: 'oncall@company.com,manager@company.com'
        subject: 'ğŸš¨ ç´§æ€¥å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
    webhook_configs:
      - url: 'http://sms-service.internal/send'
        
  # DBAå›¢é˜Ÿ
  - name: 'dba-team'
    email_configs:
      - to: 'dba@company.com'
        subject: 'æ•°æ®åº“å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
        
  # å¼€å‘å›¢é˜Ÿ
  - name: 'dev-team'
    email_configs:
      - to: 'dev@company.com'
        subject: 'åº”ç”¨å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'
        
  # è¿ç»´å›¢é˜Ÿ
  - name: 'ops-team'
    email_configs:
      - to: 'ops@company.com'
        subject: 'åŸºç¡€è®¾æ–½å‘Šè­¦ï¼š{{ .GroupLabels.alertname }}'

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # æœåŠ¡å™¨å®•æœºæŠ‘åˆ¶å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: 'ServerDown'
    target_match_re:
      alertname: '(CPUHigh|MemoryHigh|DiskSpaceLow)'
    equal: ['instance']
    
  # ä¸¥é‡å‘Šè­¦æŠ‘åˆ¶ä¸€èˆ¬å‘Šè­¦
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['service', 'instance']
```

### 8.2 å°å‹å›¢é˜Ÿé…ç½®ç¤ºä¾‹


```yaml
global:
  smtp_smarthost: 'smtp.qq.com:587'
  smtp_from: 'monitor@company.com'
  smtp_auth_username: 'monitor@company.com'
  smtp_auth_password: 'your_app_password'
  smtp_require_tls: true

route:
  group_by: ['alertname']
  group_wait: 30s
  group_interval: 10m
  repeat_interval: 24h
  receiver: 'team'
  
  routes:
    - match:
        severity: critical
      receiver: 'urgent'
      repeat_interval: 2h

receivers:
  - name: 'team'
    email_configs:
      - to: 'team@company.com'
        
  - name: 'urgent'
    email_configs:
      - to: 'team@company.com'
        subject: 'ğŸš¨ ç´§æ€¥ï¼š{{ .GroupLabels.alertname }}'
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```yaml
ğŸ”¸ é…ç½®ç»“æ„ï¼šglobal â†’ route â†’ receivers â†’ inhibit_rules â†’ templates
ğŸ”¸ è·¯ç”±é€»è¾‘ï¼šæ ‡ç­¾åŒ¹é… â†’ é€‰æ‹©æ¥æ”¶å™¨ â†’ å‘é€é€šçŸ¥
ğŸ”¸ æ—¶é—´æ§åˆ¶ï¼šgroup_waitï¼ˆç­‰å¾…åˆ†ç»„ï¼‰â†’ group_intervalï¼ˆåˆ†ç»„é—´éš”ï¼‰â†’ repeat_intervalï¼ˆé‡å¤é—´éš”ï¼‰
ğŸ”¸ é€šçŸ¥æ–¹å¼ï¼šemailã€webhookã€slackã€wechatç­‰å¤šç§é€‰æ‹©
ğŸ”¸ æŠ‘åˆ¶æœºåˆ¶ï¼šé¿å…å‘Šè­¦æ³›æ»¥ï¼Œçªå‡ºæ ¸å¿ƒé—®é¢˜
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è·¯ç”±å°±æ˜¯åˆ†å‘è§„åˆ™**
- åƒé‚®å±€åˆ†æ‹£å‘˜ï¼Œæ ¹æ®"åœ°å€"ï¼ˆæ ‡ç­¾ï¼‰åˆ†å‘åˆ°ä¸åŒ"æ”¶ä»¶äºº"ï¼ˆæ¥æ”¶å™¨ï¼‰
- ä»ä¸Šåˆ°ä¸‹åŒ¹é…ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™ç”Ÿæ•ˆ
- æ”¯æŒç²¾ç¡®åŒ¹é…å’Œæ­£åˆ™åŒ¹é…

**ğŸ”¹ æ—¶é—´å‚æ•°çš„å«ä¹‰**
- **group_wait**ï¼šç­‰ä¸€ç­‰ï¼Œçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰ç›¸å…³çš„å‘Šè­¦ä¸€èµ·å‘é€
- **group_interval**ï¼šåˆšå‘è¿‡æ¶ˆæ¯ï¼Œç­‰ç­‰å†å‘ä¸‹ä¸€æ‰¹
- **repeat_interval**ï¼šåŒæ ·çš„é—®é¢˜ä¸è¦ä¸€ç›´å‘ï¼Œè¿‡ä¸€æ®µæ—¶é—´å†æé†’

**ğŸ”¹ æ¥æ”¶å™¨æ˜¯é€šçŸ¥çš„å…·ä½“æ–¹å¼**
- ä¸€ä¸ªæ¥æ”¶å™¨å¯ä»¥åŒ…å«å¤šç§é€šçŸ¥æ–¹å¼ï¼ˆé‚®ä»¶+çŸ­ä¿¡+å¾®ä¿¡ï¼‰
- å¯ä»¥è‡ªå®šä¹‰æ¶ˆæ¯æ¨¡æ¿ï¼Œè®©å‘Šè­¦æ›´ç¾è§‚ã€æ›´æœ‰ç”¨
- æ”¯æŒæ¡ä»¶å‘é€ï¼ˆæ¯”å¦‚åªåœ¨å·¥ä½œæ—¶é—´å‘é‚®ä»¶ï¼‰

**ğŸ”¹ æŠ‘åˆ¶è§„åˆ™å‡å°‘å™ªéŸ³**
- å½“å‡ºç°æ ¹æœ¬æ€§é—®é¢˜æ—¶ï¼Œç›¸å…³çš„æ¬¡è¦å‘Šè­¦ä¼šè¢«æŠ‘åˆ¶
- å¸®åŠ©ä¸“æ³¨äºè§£å†³æ ¸å¿ƒé—®é¢˜
- é¿å…å‘Šè­¦ç–²åŠ³

### 9.3 å®é™…åº”ç”¨å»ºè®®


**âš¡ é…ç½®æœ€ä½³å®è·µ**
- **åˆ†å±‚è·¯ç”±**ï¼šæ ¹æ®ä¸¥é‡ç¨‹åº¦ã€æœåŠ¡ç±»å‹åˆ†å‘
- **æ—¶é—´åˆ†ç»„**ï¼šåˆç†è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œé¿å…å‘Šè­¦è½°ç‚¸
- **å¤šé‡é€šçŸ¥**ï¼šé‡è¦å‘Šè­¦ä½¿ç”¨å¤šç§é€šçŸ¥æ–¹å¼
- **æ¨¡æ¿å®šåˆ¶**ï¼šåˆ›å»ºæ¸…æ™°ã€æœ‰ç”¨çš„å‘Šè­¦æ¶ˆæ¯æ ¼å¼

**ğŸ”§ å¸¸è§é…ç½®æ¨¡å¼**
```
æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†å‘ï¼šcritical â†’ ç«‹å³é€šçŸ¥ â†’ å¤šç§æ–¹å¼
æŒ‰æœåŠ¡åˆ†å‘ï¼šdatabase â†’ DBAå›¢é˜Ÿï¼Œweb â†’ å¼€å‘å›¢é˜Ÿ
æŒ‰æ—¶é—´åˆ†å‘ï¼šå·¥ä½œæ—¶é—´ â†’ é‚®ä»¶ï¼Œéå·¥ä½œæ—¶é—´ â†’ çŸ­ä¿¡
```

**ğŸ¯ æ’é”™æŠ€å·§**
- ä½¿ç”¨`amtool`å‘½ä»¤è¡Œå·¥å…·æµ‹è¯•é…ç½®
- é…ç½®æ—¥å¿—çº§åˆ«ï¼Œè§‚å¯Ÿè·¯ç”±åŒ¹é…è¿‡ç¨‹
- å…ˆç”¨ç®€å•é…ç½®æµ‹è¯•é€šï¼Œå†é€æ­¥æ·»åŠ å¤æ‚è§„åˆ™
- å®šæœŸæ£€æŸ¥å‘Šè­¦æŠ‘åˆ¶æ˜¯å¦è¿‡åº¦

**æ ¸å¿ƒè®°å¿†**ï¼š
- Alertmanageræ˜¯å‘Šè­¦çš„æ™ºèƒ½ä¸­è½¬ç«™
- é…ç½®æ ¸å¿ƒæ˜¯è·¯ç”±è§„åˆ™å’Œæ¥æ”¶å™¨è®¾ç½®
- é€šè¿‡æ—¶é—´æ§åˆ¶å’ŒæŠ‘åˆ¶æœºåˆ¶é¿å…å‘Šè­¦æ³›æ»¥
- æ¨¡æ¿è®©å‘Šè­¦æ¶ˆæ¯æ›´æœ‰ç”¨æ›´ç¾è§‚