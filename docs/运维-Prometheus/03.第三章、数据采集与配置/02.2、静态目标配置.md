---
title: 2ã€é™æ€ç›®æ ‡é…ç½®
---
## ğŸ“š ç›®å½•

1. [é™æ€é…ç½®åŸºç¡€æ¦‚å¿µ](#1-é™æ€é…ç½®åŸºç¡€æ¦‚å¿µ)
2. [static_configsé…ç½®è¯¦è§£](#2-static_configsé…ç½®è¯¦è§£)
3. [targetsç›®æ ‡åˆ—è¡¨ç®¡ç†](#3-targetsç›®æ ‡åˆ—è¡¨ç®¡ç†)
4. [æ ‡ç­¾ç³»ç»Ÿæ·±å…¥ç†è§£](#4-æ ‡ç­¾ç³»ç»Ÿæ·±å…¥ç†è§£)
5. [å¤šç¯å¢ƒé…ç½®ç­–ç•¥](#5-å¤šç¯å¢ƒé…ç½®ç­–ç•¥)
6. [é…ç½®æ–‡ä»¶ç»„ç»‡æœ€ä½³å®è·µ](#6-é…ç½®æ–‡ä»¶ç»„ç»‡æœ€ä½³å®è·µ)
7. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#7-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é™æ€é…ç½®åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é™æ€ç›®æ ‡é…ç½®


**é€šä¿—ç†è§£**ï¼šé™æ€ç›®æ ‡é…ç½®å°±åƒæ˜¯ç»™Prometheusä¸€ä»½"ç›‘æ§æ¸…å•"ï¼Œå‘Šè¯‰å®ƒéœ€è¦ç›‘æ§å“ªäº›æœåŠ¡å™¨ã€åº”ç”¨ç¨‹åºçš„åœ°å€ã€‚

```
ç±»æ¯”ç”Ÿæ´»åœºæ™¯ï¼š
å¿«é€’å‘˜çš„æ´¾é€å• â†’ Prometheusçš„ç›‘æ§é…ç½®
æ”¶ä»¶äººåœ°å€åˆ—è¡¨ â†’ ç›‘æ§ç›®æ ‡åœ°å€åˆ—è¡¨
æ´¾é€è·¯çº¿è§„åˆ’ â†’ æ•°æ®é‡‡é›†ç­–ç•¥
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- ğŸ¯ **é™æ€**ï¼šæ‰‹å·¥é…ç½®ï¼Œä¸ä¼šè‡ªåŠ¨å˜åŒ–çš„ç›‘æ§ç›®æ ‡
- ğŸ“ **ç›®æ ‡**ï¼šéœ€è¦ç›‘æ§çš„å…·ä½“æœåŠ¡åœ°å€ï¼ˆIP:ç«¯å£ï¼‰
- ğŸ“‹ **é…ç½®**ï¼šå‘Šè¯‰Prometheuså»å“ªé‡Œé‡‡é›†æ•°æ®

### 1.2 é™æ€é…ç½®çš„ç‰¹ç‚¹


| ç‰¹ç‚¹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **æ‰‹åŠ¨ç»´æŠ¤** | éœ€è¦äººå·¥æ·»åŠ /åˆ é™¤ç›‘æ§ç›®æ ‡ | æœåŠ¡å™¨æ•°é‡å›ºå®šçš„ç¯å¢ƒ |
| **é…ç½®ç®€å•** | ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºåœ°å€ | å°è§„æ¨¡éƒ¨ç½²ï¼Œæµ‹è¯•ç¯å¢ƒ |
| **ç«‹å³ç”Ÿæ•ˆ** | é‡å¯åé…ç½®é©¬ä¸Šç”Ÿæ•ˆ | éœ€è¦ç²¾ç¡®æ§åˆ¶ç›‘æ§èŒƒå›´ |
| **æˆæœ¬è¾ƒä½** | ä¸éœ€è¦é¢å¤–çš„æœåŠ¡å‘ç°ç»„ä»¶ | é¢„ç®—æœ‰é™çš„é¡¹ç›® |

### 1.3 é™æ€é…ç½®åœ¨Prometheusä¸­çš„ä½ç½®


```
Prometheusæ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é…ç½®æ–‡ä»¶       â”‚â”€â”€â”€â–¶â”‚   Prometheus    â”‚â”€â”€â”€â–¶â”‚   æ—¶åºæ•°æ®åº“     â”‚
â”‚ prometheus.yml  â”‚    â”‚     Server      â”‚    â”‚   (å­˜å‚¨æ•°æ®)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ static_configs  â”‚    â”‚   æ•°æ®é‡‡é›†å™¨     â”‚
â”‚  (é™æ€ç›®æ ‡)     â”‚    â”‚ (å®šæœŸæ‹‰å–æ•°æ®)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”§ static_configsé…ç½®è¯¦è§£


### 2.1 åŸºæœ¬é…ç½®è¯­æ³•


**æœ€ç®€å•çš„é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# prometheus.yml åŸºç¡€é…ç½®
scrape_configs:
  - job_name: 'web-servers'           # ç»™è¿™ç»„ç›‘æ§ç›®æ ‡èµ·ä¸ªåå­—
    static_configs:
      - targets: ['192.168.1.10:9100'] # è¦ç›‘æ§çš„æœåŠ¡å™¨åœ°å€
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼š`job_name`å°±åƒç»™ä¸€ç¾¤æœåŠ¡å™¨èµ·ä¸ªç»„åï¼Œæ–¹ä¾¿ç®¡ç†å’ŒæŸ¥è¯¢

### 2.2 é…ç½®æ–‡ä»¶ç»“æ„è§£æ


```yaml
# å®Œæ•´çš„static_configsé…ç½®ç»“æ„
scrape_configs:
  - job_name: 'my-application'        # ğŸ“ ä»»åŠ¡åç§°ï¼ˆå¿…å¡«ï¼‰
    scrape_interval: 15s              # â° é‡‡é›†é—´éš”ï¼ˆå¯é€‰ï¼‰
    scrape_timeout: 10s               # â±ï¸ é‡‡é›†è¶…æ—¶ï¼ˆå¯é€‰ï¼‰
    static_configs:
      - targets:                      # ğŸ¯ ç›‘æ§ç›®æ ‡åˆ—è¡¨
          - '192.168.1.10:9100'       
          - '192.168.1.11:9100'       
        labels:                       # ğŸ·ï¸ è‡ªå®šä¹‰æ ‡ç­¾
          environment: 'production'    
          team: 'backend'             
```

**å­—æ®µå«ä¹‰è¯¦è§£**ï¼š

ğŸ”¸ **job_name**ï¼š
- **ä½œç”¨**ï¼šç»™è¿™æ‰¹ç›‘æ§ç›®æ ‡èµ·ä¸ªåå­—ï¼Œå°±åƒæ–‡ä»¶å¤¹åç§°
- **è¦æ±‚**ï¼šå¿…é¡»å”¯ä¸€ï¼Œä¸èƒ½é‡å¤
- **å»ºè®®**ï¼šç”¨æœ‰æ„ä¹‰çš„åç§°ï¼Œå¦‚`web-servers`ã€`database-cluster`

ğŸ”¸ **scrape_interval**ï¼š
- **ä½œç”¨**ï¼šå¤šä¹…é‡‡é›†ä¸€æ¬¡æ•°æ®
- **é»˜è®¤å€¼**ï¼šå…¨å±€é…ç½®ä¸­çš„å€¼ï¼ˆé€šå¸¸15ç§’ï¼‰
- **æ ¼å¼**ï¼š`15s`ï¼ˆç§’ï¼‰ã€`1m`ï¼ˆåˆ†é’Ÿï¼‰ã€`1h`ï¼ˆå°æ—¶ï¼‰

ğŸ”¸ **scrape_timeout**ï¼š
- **ä½œç”¨**ï¼šç­‰å¾…å“åº”çš„æœ€é•¿æ—¶é—´
- **æ³¨æ„**ï¼šå¿…é¡»å°äºé‡‡é›†é—´éš”
- **å»ºè®®**ï¼šè®¾ç½®ä¸ºé‡‡é›†é—´éš”çš„70%å·¦å³

### 2.3 å®é™…é…ç½®ç¤ºä¾‹


```yaml
# ç›‘æ§WebæœåŠ¡å™¨é›†ç¾¤
scrape_configs:
  - job_name: 'web-frontend'
    scrape_interval: 30s
    scrape_timeout: 10s
    static_configs:
      - targets:
          - '10.0.1.10:9100'    # WebæœåŠ¡å™¨1
          - '10.0.1.11:9100'    # WebæœåŠ¡å™¨2
          - '10.0.1.12:9100'    # WebæœåŠ¡å™¨3
        labels:
          role: 'frontend'
          datacenter: 'beijing'
          
  - job_name: 'database-servers'
    scrape_interval: 60s          # æ•°æ®åº“ç›‘æ§é¢‘ç‡å¯ä»¥ä½ä¸€äº›
    static_configs:
      - targets:
          - '10.0.2.10:9104'    # MySQLå¯¼å‡ºå™¨
          - '10.0.2.11:9187'    # PostgreSQLå¯¼å‡ºå™¨
        labels:
          role: 'database'
          backup: 'enabled'
```

---

## 3. ğŸ“‹ targetsç›®æ ‡åˆ—è¡¨ç®¡ç†


### 3.1 targetsçš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯targets**ï¼š
targetså°±æ˜¯å‘Šè¯‰Prometheus"å»è¿™äº›åœ°å€æ”¶é›†ç›‘æ§æ•°æ®"çš„åœ°å€æ¸…å•ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
å¤–å–å¹³å°çš„å•†å®¶åˆ—è¡¨ â†’ Prometheusçš„targetsåˆ—è¡¨
å•†å®¶åœ°å€å’Œç”µè¯ â†’ æœåŠ¡å™¨IPå’Œç«¯å£å·
ä¸‹å•é…é€ â†’ æ•°æ®é‡‡é›†è¿‡ç¨‹
```

### 3.2 targetsåœ°å€æ ¼å¼è§„èŒƒ


**æ ‡å‡†æ ¼å¼**ï¼š`IPåœ°å€:ç«¯å£å·`

```yaml
# âœ… æ­£ç¡®çš„åœ°å€æ ¼å¼
targets:
  - '192.168.1.10:9100'        # IPv4 + ç«¯å£
  - 'server1.company.com:9100' # åŸŸå + ç«¯å£
  - '[::1]:9100'               # IPv6 + ç«¯å£ï¼ˆéœ€è¦æ–¹æ‹¬å·ï¼‰
  
# âŒ é”™è¯¯çš„æ ¼å¼ç¤ºä¾‹
targets:
  - '192.168.1.10'             # ç¼ºå°‘ç«¯å£å·
  - 'http://192.168.1.10:9100' # ä¸éœ€è¦åè®®å‰ç¼€
  - '192.168.1.10:9100/metrics'# ä¸éœ€è¦è·¯å¾„
```

> âš ï¸ **é‡è¦æé†’**ï¼šPrometheusé»˜è®¤ä½¿ç”¨HTTPåè®®è®¿é—®/metricsè·¯å¾„ï¼Œæ‰€ä»¥åœ°å€ä¸­åªéœ€è¦IPå’Œç«¯å£

### 3.3 å¤šç›®æ ‡é…ç½®ç®¡ç†


**åœºæ™¯1ï¼šåŒä¸€ç±»æœåŠ¡çš„å¤šä¸ªå®ä¾‹**
```yaml
# WebæœåŠ¡å™¨é›†ç¾¤ç›‘æ§
- job_name: 'web-cluster'
  static_configs:
    - targets:
        - '10.0.1.10:9100'    # nginx-1
        - '10.0.1.11:9100'    # nginx-2  
        - '10.0.1.12:9100'    # nginx-3
        - '10.0.1.13:9100'    # nginx-4
      labels:
        service: 'nginx'
        region: 'east'
```

**åœºæ™¯2ï¼šä¸åŒç«¯å£çš„å¤šä¸ªæœåŠ¡**
```yaml
# åŒä¸€å°æœåŠ¡å™¨çš„å¤šä¸ªç›‘æ§ç«¯ç‚¹
- job_name: 'server-monitoring'
  static_configs:
    - targets:
        - '192.168.1.100:9100'  # Node Exporter (ç³»ç»Ÿç›‘æ§)
        - '192.168.1.100:9187'  # PostgreSQL Exporter
        - '192.168.1.100:9113'  # Nginx Exporter
      labels:
        hostname: 'prod-server-01'
```

### 3.4 targetsçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†


**æ·»åŠ æ–°ç›®æ ‡**ï¼š
```yaml
# åŸæœ‰é…ç½®
targets:
  - '192.168.1.10:9100'
  - '192.168.1.11:9100'

# æ·»åŠ æ–°æœåŠ¡å™¨å
targets:
  - '192.168.1.10:9100'
  - '192.168.1.11:9100'
  - '192.168.1.12:9100'    # æ–°å¢æœåŠ¡å™¨
```

**ç§»é™¤å¤±æ•ˆç›®æ ‡**ï¼š
```yaml
# æœåŠ¡å™¨ä¸‹çº¿æ—¶éœ€è¦ä»é…ç½®ä¸­ç§»é™¤
targets:
  - '192.168.1.10:9100'
  - '192.168.1.11:9100'
  # - '192.168.1.12:9100'  # æ³¨é‡Šæ‰å·²ä¸‹çº¿çš„æœåŠ¡å™¨
```

> ğŸ“ **ç»´æŠ¤å»ºè®®**ï¼šå®šæœŸæ£€æŸ¥targetsåˆ—è¡¨ï¼ŒåŠæ—¶æ·»åŠ æ–°æœåŠ¡å™¨ï¼Œç§»é™¤å·²ä¸‹çº¿çš„æœåŠ¡å™¨

---

## 4. ğŸ·ï¸ æ ‡ç­¾ç³»ç»Ÿæ·±å…¥ç†è§£


### 4.1 æ ‡ç­¾çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ ‡ç­¾**ï¼š
æ ‡ç­¾å°±åƒæ˜¯ç»™ç›‘æ§æ•°æ®è´´çš„"æ ‡è¯†ç‰Œ"ï¼Œå¸®åŠ©æˆ‘ä»¬åˆ†ç±»å’ŒæŸ¥æ‰¾æ•°æ®ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
å›¾ä¹¦é¦†çš„åˆ†ç±»æ ‡ç­¾ â†’ Prometheusçš„labels
ä¹¦ç±åˆ†ç±»ï¼ˆæ–‡å­¦ã€ç§‘æŠ€ã€å†å²ï¼‰â†’ æœåŠ¡åˆ†ç±»ï¼ˆwebã€databaseã€cacheï¼‰
æŸ¥æ‰¾ç‰¹å®šç±»å‹çš„ä¹¦ â†’ æŸ¥è¯¢ç‰¹å®šæ ‡ç­¾çš„ç›‘æ§æ•°æ®
```

### 4.2 æ ‡ç­¾çš„ä½œç”¨å’Œä»·å€¼


**ğŸ¯ ä¸»è¦ä½œç”¨**ï¼š
- **æ•°æ®åˆ†ç±»**ï¼šåŒºåˆ†ä¸åŒç¯å¢ƒã€ä¸åŒæœåŠ¡ç±»å‹
- **æŸ¥è¯¢è¿‡æ»¤**ï¼šå¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„ç›‘æ§æ•°æ®
- **å‘Šè­¦è§„åˆ™**ï¼šåŸºäºæ ‡ç­¾è®¾ç½®ä¸åŒçš„å‘Šè­¦ç­–ç•¥
- **å›¾è¡¨å±•ç¤º**ï¼šæŒ‰æ ‡ç­¾åˆ†ç»„å±•ç¤ºç›‘æ§å›¾è¡¨

### 4.3 æ ‡ç­¾æ·»åŠ çš„ä¸¤ç§æ–¹å¼


**æ–¹å¼1ï¼šåœ¨static_configsä¸­æ·»åŠ **
```yaml
scrape_configs:
  - job_name: 'web-servers'
    static_configs:
      - targets: ['192.168.1.10:9100']
        labels:
          environment: 'production'    # ç¯å¢ƒæ ‡ç­¾
          service: 'nginx'            # æœåŠ¡ç±»å‹æ ‡ç­¾
          team: 'frontend'            # è´Ÿè´£å›¢é˜Ÿæ ‡ç­¾
          version: 'v1.2.0'          # ç‰ˆæœ¬æ ‡ç­¾
```

**æ–¹å¼2ï¼šä½¿ç”¨relabel_configsä¿®æ”¹æ ‡ç­¾**
```yaml
scrape_configs:
  - job_name: 'web-servers'
    static_configs:
      - targets: ['192.168.1.10:9100']
    relabel_configs:
      - target_label: 'environment'
        replacement: 'production'
```

### 4.4 æ ‡ç­¾å‘½åæœ€ä½³å®è·µ


**ğŸ”¸ æ ‡ç­¾å‘½åè§„èŒƒ**ï¼š

| æ ‡ç­¾ç±»å‹ | å‘½åå»ºè®® | ç¤ºä¾‹ |
|---------|---------|------|
| **ç¯å¢ƒ** | environment | `dev`, `test`, `prod` |
| **æœåŠ¡ç±»å‹** | service | `nginx`, `mysql`, `redis` |
| **å›¢é˜Ÿ** | team | `frontend`, `backend`, `ops` |
| **åœ°åŸŸ** | region/datacenter | `beijing`, `shanghai`, `aws-east` |
| **ç‰ˆæœ¬** | version | `v1.0.0`, `latest` |

**æ¨èçš„æ ‡ç­¾ç»„åˆ**ï¼š
```yaml
labels:
  environment: 'production'      # ç¯å¢ƒï¼šç”Ÿäº§/æµ‹è¯•/å¼€å‘
  service: 'user-api'           # æœåŠ¡åç§°
  team: 'backend'               # è´Ÿè´£å›¢é˜Ÿ  
  datacenter: 'beijing'         # æ•°æ®ä¸­å¿ƒ
  instance_type: 'web'          # å®ä¾‹ç±»å‹
```

### 4.5 æ ‡ç­¾è¦†ç›–æœºåˆ¶


**æ ‡ç­¾ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰**ï¼š
1. Prometheusè‡ªåŠ¨æ·»åŠ çš„æ ‡ç­¾ï¼ˆå¦‚`__address__`ï¼‰
2. relabel_configså¤„ç†åçš„æ ‡ç­¾
3. static_configsä¸­å®šä¹‰çš„labels
4. ç›®æ ‡æœåŠ¡è¿”å›çš„æ ‡ç­¾

```yaml
# ç¤ºä¾‹ï¼šæ ‡ç­¾è¦†ç›–æ¼”ç¤º
static_configs:
  - targets: ['192.168.1.10:9100']
    labels:
      job: 'my-custom-job'        # è¿™ä¼šè¦†ç›–é»˜è®¤çš„jobæ ‡ç­¾
      instance: 'server-01'       # è¿™ä¼šè¦†ç›–é»˜è®¤çš„instanceæ ‡ç­¾
      custom_label: 'my-value'    # è¿™æ˜¯æ–°å¢çš„æ ‡ç­¾
```

---

## 5. ğŸŒ å¤šç¯å¢ƒé…ç½®ç­–ç•¥


### 5.1 ç¯å¢ƒåˆ’åˆ†çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆè¦åˆ’åˆ†ç¯å¢ƒ**ï¼š
- **éš”ç¦»é£é™©**ï¼šå¼€å‘æµ‹è¯•ä¸å½±å“ç”Ÿäº§ç¯å¢ƒ
- **é…ç½®ç®¡ç†**ï¼šä¸åŒç¯å¢ƒå¯èƒ½æœ‰ä¸åŒçš„ç›‘æ§éœ€æ±‚
- **æƒé™æ§åˆ¶**ï¼šä¸åŒå›¢é˜Ÿè®¿é—®ä¸åŒç¯å¢ƒçš„æ•°æ®
- **æˆæœ¬ä¼˜åŒ–**ï¼šæµ‹è¯•ç¯å¢ƒå¯ä»¥ä½¿ç”¨è¾ƒä½çš„ç›‘æ§é¢‘ç‡

### 5.2 åŸºäºç¯å¢ƒçš„é…ç½®æ¨¡å¼


**æ¨¡å¼1ï¼šå•æ–‡ä»¶å¤šç¯å¢ƒ**
```yaml
# prometheus.yml - ç»Ÿä¸€é…ç½®æ–‡ä»¶
global:
  scrape_interval: 15s

scrape_configs:
  # ç”Ÿäº§ç¯å¢ƒ Web æœåŠ¡å™¨
  - job_name: 'prod-web-servers'
    scrape_interval: 15s           # ç”Ÿäº§ç¯å¢ƒç›‘æ§é¢‘ç‡é«˜
    static_configs:
      - targets:
          - '10.1.1.10:9100'
          - '10.1.1.11:9100'
        labels:
          environment: 'production'
          service: 'web'
          
  # æµ‹è¯•ç¯å¢ƒ Web æœåŠ¡å™¨  
  - job_name: 'test-web-servers'
    scrape_interval: 60s           # æµ‹è¯•ç¯å¢ƒç›‘æ§é¢‘ç‡ä½
    static_configs:
      - targets:
          - '10.2.1.10:9100'
          - '10.2.1.11:9100'
        labels:
          environment: 'test'
          service: 'web'
          
  # å¼€å‘ç¯å¢ƒ Web æœåŠ¡å™¨
  - job_name: 'dev-web-servers'
    scrape_interval: 120s          # å¼€å‘ç¯å¢ƒç›‘æ§é¢‘ç‡æœ€ä½
    static_configs:
      - targets:
          - '10.3.1.10:9100'
        labels:
          environment: 'development'
          service: 'web'
```

**æ¨¡å¼2ï¼šå¤šæ–‡ä»¶åˆ†ç¯å¢ƒ**
```
é…ç½®æ–‡ä»¶ç»“æ„ï¼š
prometheus/
â”œâ”€â”€ prometheus.yml              # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ production.yml         # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ testing.yml           # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ development.yml       # å¼€å‘ç¯å¢ƒé…ç½®
```

```yaml
# prometheus.yml ä¸»é…ç½®
global:
  scrape_interval: 15s

# å¼•å…¥ç¯å¢ƒé…ç½®æ–‡ä»¶
scrape_config_files:
  - "environments/*.yml"
```

```yaml
# environments/production.yml
- job_name: 'prod-web-cluster'
  scrape_interval: 15s
  static_configs:
    - targets:
        - '10.1.1.10:9100'
        - '10.1.1.11:9100'
        - '10.1.1.12:9100'
      labels:
        environment: 'production'
        cluster: 'web-frontend'
        criticality: 'high'
        
- job_name: 'prod-database-cluster'
  scrape_interval: 30s
  static_configs:
    - targets:
        - '10.1.2.10:9104'    # MySQL
        - '10.1.2.11:9187'    # PostgreSQL
      labels:
        environment: 'production'
        cluster: 'database'
        criticality: 'critical'
```

### 5.3 ç¯å¢ƒé…ç½®å·®å¼‚åŒ–ç­–ç•¥


**ç›‘æ§é¢‘ç‡å·®å¼‚åŒ–**ï¼š
```yaml
# ç”Ÿäº§ç¯å¢ƒï¼šé«˜é¢‘ç›‘æ§
scrape_interval: 15s    # æ¯15ç§’é‡‡é›†ä¸€æ¬¡
scrape_timeout: 10s     # è¶…æ—¶æ—¶é—´çŸ­

# æµ‹è¯•ç¯å¢ƒï¼šä¸­é¢‘ç›‘æ§  
scrape_interval: 60s    # æ¯1åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡
scrape_timeout: 30s     # è¶…æ—¶æ—¶é—´é€‚ä¸­

# å¼€å‘ç¯å¢ƒï¼šä½é¢‘ç›‘æ§
scrape_interval: 300s   # æ¯5åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡  
scrape_timeout: 60s     # è¶…æ—¶æ—¶é—´é•¿
```

**æ ‡ç­¾ç­–ç•¥å·®å¼‚åŒ–**ï¼š
```yaml
# ç”Ÿäº§ç¯å¢ƒï¼šè¯¦ç»†æ ‡ç­¾
labels:
  environment: 'production'
  service: 'user-api'
  version: 'v2.1.0'
  team: 'backend'
  sla_level: 'gold'
  backup_enabled: 'true'
  
# å¼€å‘ç¯å¢ƒï¼šç®€åŒ–æ ‡ç­¾
labels:
  environment: 'development'
  service: 'user-api'
  developer: 'zhangsan'
```

---

## 6. ğŸ“ é…ç½®æ–‡ä»¶ç»„ç»‡æœ€ä½³å®è·µ


### 6.1 é¡¹ç›®é…ç½®æ–‡ä»¶ç»“æ„


**æ¨èçš„ç›®å½•ç»“æ„**ï¼š
```
prometheus-config/
â”œâ”€â”€ prometheus.yml                 # ğŸ  ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ targets/                       # ğŸ“ ç›®æ ‡é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ web-services.yml          # ğŸŒ WebæœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ databases.yml             # ğŸ—„ï¸ æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ middleware.yml            # âš™ï¸ ä¸­é—´ä»¶é…ç½®
â”‚   â””â”€â”€ infrastructure.yml        # ğŸ—ï¸ åŸºç¡€è®¾æ–½é…ç½®
â”œâ”€â”€ environments/                  # ğŸŒ ç¯å¢ƒé…ç½®ç›®å½•
â”‚   â”œâ”€â”€ production/               # ğŸ”¥ ç”Ÿäº§ç¯å¢ƒ
â”‚   â”œâ”€â”€ staging/                  # ğŸ§ª é¢„å‘å¸ƒç¯å¢ƒ
â”‚   â””â”€â”€ development/              # ğŸ’» å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ rules/                        # ğŸ“‹ å‘Šè­¦è§„åˆ™ç›®å½•
â”‚   â”œâ”€â”€ general.yml               # é€šç”¨è§„åˆ™
â”‚   â””â”€â”€ service-specific.yml      # æœåŠ¡ä¸“ç”¨è§„åˆ™
â””â”€â”€ docs/                         # ğŸ“š æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ configuration-guide.md    # é…ç½®è¯´æ˜
    â””â”€â”€ troubleshooting.md        # æ•…éšœæ’é™¤
```

### 6.2 ä¸»é…ç½®æ–‡ä»¶ç»„ç»‡


```yaml
# prometheus.yml - ä¸»é…ç½®æ–‡ä»¶
global:
  scrape_interval: 15s             # å…¨å±€é‡‡é›†é—´éš”
  evaluation_interval: 15s         # è§„åˆ™è¯„ä¼°é—´éš”
  external_labels:                 # å¤–éƒ¨æ ‡ç­¾ï¼ˆç”¨äºè”é‚¦å’Œè¿œç¨‹å­˜å‚¨ï¼‰
    cluster: 'main-prometheus'
    replica: '1'

# å‘Šè­¦è§„åˆ™æ–‡ä»¶
rule_files:
  - "rules/*.yml"

# ç›‘æ§ç›®æ ‡é…ç½®
scrape_configs:
  # ğŸ¯ Prometheus è‡ªèº«ç›‘æ§
  - job_name: 'prometheus-server'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
          role: 'monitoring'
          
# ğŸ“ å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶  
scrape_config_files:
  - "targets/*.yml"
  - "environments/production/*.yml"
```

### 6.3 æœåŠ¡åˆ†ç±»é…ç½®ç¤ºä¾‹


**WebæœåŠ¡é…ç½®æ–‡ä»¶**ï¼š
```yaml
# targets/web-services.yml
# ğŸŒ Webå‰ç«¯æœåŠ¡ç›‘æ§é…ç½®

- job_name: 'nginx-frontend'
  scrape_interval: 30s
  static_configs:
    - targets:
        - '10.0.1.10:9113'        # Nginx Exporter
        - '10.0.1.11:9113'
        - '10.0.1.12:9113'
      labels:
        service: 'nginx'
        role: 'frontend'
        load_balancer: 'enabled'
        
- job_name: 'nodejs-api'
  scrape_interval: 15s
  static_configs:
    - targets:
        - '10.0.2.10:3000'        # Node.jsåº”ç”¨å†…ç½®metrics
        - '10.0.2.11:3000'
      labels:
        service: 'nodejs'
        role: 'api-server'
        framework: 'express'
```

**æ•°æ®åº“é…ç½®æ–‡ä»¶**ï¼š
```yaml
# targets/databases.yml  
# ğŸ—„ï¸ æ•°æ®åº“æœåŠ¡ç›‘æ§é…ç½®

- job_name: 'mysql-cluster'
  scrape_interval: 60s            # æ•°æ®åº“ç›‘æ§é¢‘ç‡å¯ä»¥ä½ä¸€äº›
  scrape_timeout: 30s
  static_configs:
    - targets:
        - '10.0.3.10:9104'        # MySQL Exporter
      labels:
        service: 'mysql'
        role: 'master'
        cluster: 'user-data'
    - targets:
        - '10.0.3.11:9104'
        - '10.0.3.12:9104'
      labels:
        service: 'mysql'
        role: 'slave'
        cluster: 'user-data'
        
- job_name: 'redis-cache'
  scrape_interval: 30s
  static_configs:
    - targets:
        - '10.0.4.10:9121'        # Redis Exporter
        - '10.0.4.11:9121'
      labels:
        service: 'redis'
        role: 'cache'
        cluster: 'session-store'
```

### 6.4 é…ç½®ç‰ˆæœ¬ç®¡ç†


**ä½¿ç”¨Gitç®¡ç†é…ç½®**ï¼š
```bash
# ğŸ“ é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
git init
git add prometheus.yml targets/ environments/
git commit -m "Initial Prometheus configuration"

# ğŸ·ï¸ ç‰ˆæœ¬æ ‡è®°
git tag -a v1.0.0 -m "Production ready configuration v1.0.0"
```

**é…ç½®å˜æ›´è®°å½•**ï¼š
```yaml
# prometheus.yml æ–‡ä»¶å¤´éƒ¨æ³¨é‡Š
# ===================================================================
# Prometheus Configuration File
# 
# Version: 2.1.0
# Last Modified: 2025-09-21
# Author: DevOps Team
# 
# Changes in this version:
# - Added Redis monitoring targets
# - Updated scrape intervals for production
# - Added new environment labels
# ===================================================================
```

---

## 7. â— å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


### 7.1 é…ç½®è¯­æ³•é”™è¯¯


**é—®é¢˜1ï¼šYAMLæ ¼å¼é”™è¯¯**
```yaml
# âŒ é”™è¯¯çš„ç¼©è¿›
scrape_configs:
- job_name: 'web-servers'
  static_configs:
  - targets: ['192.168.1.10:9100']    # ç¼©è¿›ä¸å¯¹

# âœ… æ­£ç¡®çš„ç¼©è¿›  
scrape_configs:
  - job_name: 'web-servers'
    static_configs:
      - targets: ['192.168.1.10:9100']  # ç¼©è¿›æ­£ç¡®
```

**é—®é¢˜2ï¼šå¼•å·ä½¿ç”¨é”™è¯¯**
```yaml
# âŒ æ··ç”¨å•åŒå¼•å·
targets: ['192.168.1.10:9100", "192.168.1.11:9100']

# âœ… ç»Ÿä¸€ä½¿ç”¨å¼•å·
targets: ['192.168.1.10:9100', '192.168.1.11:9100']
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨YAMLæ ¼å¼æ£€æŸ¥å·¥å…·éªŒè¯é…ç½®
- ä¿æŒä¸€è‡´çš„ç¼©è¿›ï¼ˆå»ºè®®2ä¸ªç©ºæ ¼ï¼‰
- ç»Ÿä¸€ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·

### 7.2 ç›®æ ‡è¿æ¥é—®é¢˜


**é—®é¢˜ï¼šæ— æ³•è¿æ¥åˆ°ç›‘æ§ç›®æ ‡**

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1ï¸âƒ£ æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping 192.168.1.10

# 2ï¸âƒ£ æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
telnet 192.168.1.10 9100

# 3ï¸âƒ£ æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://192.168.1.10:9100/metrics

# 4ï¸âƒ£ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
sudo ufw status
sudo firewall-cmd --list-ports
```

**å¸¸è§è§£å†³æ–¹æ¡ˆ**ï¼š
- **ç½‘ç»œé—®é¢˜**ï¼šæ£€æŸ¥è·¯ç”±ã€é˜²ç«å¢™è§„åˆ™
- **ç«¯å£é—®é¢˜**ï¼šç¡®è®¤exporteræœåŠ¡æ­£åœ¨è¿è¡Œ
- **æƒé™é—®é¢˜**ï¼šæ£€æŸ¥Prometheusæ˜¯å¦æœ‰è®¿é—®æƒé™

### 7.3 æ€§èƒ½ä¼˜åŒ–é—®é¢˜


**é—®é¢˜ï¼šç›‘æ§ç›®æ ‡è¿‡å¤šå¯¼è‡´æ€§èƒ½ä¸‹é™**

**ä¼˜åŒ–ç­–ç•¥**ï¼š
```yaml
# ğŸ”¸ è°ƒæ•´é‡‡é›†é—´éš”
scrape_configs:
  - job_name: 'high-priority-services'
    scrape_interval: 15s          # é‡è¦æœåŠ¡é«˜é¢‘é‡‡é›†
    
  - job_name: 'low-priority-services'  
    scrape_interval: 300s         # æ¬¡è¦æœåŠ¡ä½é¢‘é‡‡é›†
    
# ğŸ”¸ è®¾ç½®åˆç†è¶…æ—¶æ—¶é—´
  - job_name: 'slow-services'
    scrape_timeout: 30s           # ç»™æ…¢æœåŠ¡æ›´å¤šæ—¶é—´
```

### 7.4 æ ‡ç­¾å†²çªé—®é¢˜


**é—®é¢˜ï¼šæ ‡ç­¾åç§°å†²çªæˆ–é‡å¤**

```yaml
# âŒ é—®é¢˜é…ç½®ï¼šæ ‡ç­¾å†²çª
scrape_configs:
  - job_name: 'web-servers'
    static_configs:
      - targets: ['192.168.1.10:9100']
        labels:
          job: 'custom-job'       # ä¸é»˜è®¤jobæ ‡ç­¾å†²çª
          
# âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ä¸åŒæ ‡ç­¾å
      - targets: ['192.168.1.10:9100']  
        labels:
          service_name: 'web-frontend'  # ä½¿ç”¨ä¸åŒçš„æ ‡ç­¾å
          custom_job: 'my-job'          # é¿å…å†²çª
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é™æ€é…ç½®ï¼šæ‰‹å·¥ç»´æŠ¤çš„ç›‘æ§ç›®æ ‡åˆ—è¡¨ï¼Œé€‚ç”¨äºå›ºå®šç¯å¢ƒ
ğŸ”¸ static_configsï¼šPrometheusé…ç½®ä¸­å®šä¹‰ç›‘æ§ç›®æ ‡çš„ä¸»è¦æ–¹å¼
ğŸ”¸ targetsï¼šå…·ä½“çš„ç›‘æ§åœ°å€åˆ—è¡¨ï¼Œæ ¼å¼ä¸º"IP:ç«¯å£"
ğŸ”¸ labelsï¼šç»™ç›‘æ§æ•°æ®æ·»åŠ æ ‡è¯†ï¼Œç”¨äºåˆ†ç±»å’ŒæŸ¥è¯¢
ğŸ”¸ job_nameï¼šç›‘æ§ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„ç›‘æ§ç»„
```

### 8.2 å…³é”®é…ç½®è¦ç´ 


**ğŸ”¹ åŸºç¡€é…ç½®ä¸‰è¦ç´ **ï¼š
1. **job_name**ï¼šç»™ç›‘æ§ä»»åŠ¡èµ·åå­—
2. **targets**ï¼šæŒ‡å®šç›‘æ§åœ°å€åˆ—è¡¨  
3. **labels**ï¼šæ·»åŠ åˆ†ç±»æ ‡ç­¾

**ğŸ”¹ ä¼˜åŒ–é…ç½®è¦ç´ **ï¼š
1. **scrape_interval**ï¼šæ§åˆ¶é‡‡é›†é¢‘ç‡
2. **scrape_timeout**ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´
3. **ç¯å¢ƒåˆ†ç¦»**ï¼šåŒºåˆ†ç”Ÿäº§ã€æµ‹è¯•ã€å¼€å‘ç¯å¢ƒ

### 8.3 æœ€ä½³å®è·µè¦ç‚¹


**ğŸ¯ é…ç½®ç®¡ç†å»ºè®®**ï¼š
- **æ–‡ä»¶ç»„ç»‡**ï¼šæŒ‰æœåŠ¡ç±»å‹åˆ†æ–‡ä»¶ï¼ŒæŒ‰ç¯å¢ƒåˆ†ç›®å½•
- **æ ‡ç­¾è§„èŒƒ**ï¼šç»Ÿä¸€å‘½åè§„èŒƒï¼Œé¿å…å†²çª
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šä½¿ç”¨Gitç®¡ç†é…ç½®å˜æ›´
- **æ–‡æ¡£ç»´æŠ¤**ï¼šè®°å½•é…ç½®è¯´æ˜å’Œå˜æ›´å†å²

**ğŸ”§ è¿ç»´ç»´æŠ¤è¦ç‚¹**ï¼š
- **å®šæœŸæ£€æŸ¥**ï¼šåŠæ—¶æ›´æ–°å¤±æ•ˆçš„ç›‘æ§ç›®æ ‡
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ®é‡è¦æ€§è°ƒæ•´é‡‡é›†é¢‘ç‡
- **æ•…éšœæ’é™¤**ï¼šå»ºç«‹æ ‡å‡†çš„é—®é¢˜æ’æŸ¥æµç¨‹
- **ç›‘æ§ç›‘æ§**ï¼šç›‘æ§Prometheusè‡ªèº«çš„å¥åº·çŠ¶æ€

### 8.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


```
æ–°æ‰‹å…¥é—¨è·¯å¾„ï¼š
1ï¸âƒ£ æŒæ¡åŸºç¡€é…ç½®è¯­æ³• â†’ èƒ½å†™å‡ºåŸºæœ¬çš„static_configs
2ï¸âƒ£ ç†è§£æ ‡ç­¾ç³»ç»Ÿ â†’ èƒ½åˆç†ä½¿ç”¨labelsåˆ†ç±»æ•°æ®  
3ï¸âƒ£ å­¦ä¼šå¤šç¯å¢ƒç®¡ç† â†’ èƒ½åŒºåˆ†ä¸åŒç¯å¢ƒçš„é…ç½®
4ï¸âƒ£ æŒæ¡æ–‡ä»¶ç»„ç»‡ â†’ èƒ½ç®¡ç†å¤§è§„æ¨¡çš„é…ç½®æ–‡ä»¶
5ï¸âƒ£ å­¦ä¹ æ€§èƒ½ä¼˜åŒ– â†’ èƒ½ä¼˜åŒ–ç›‘æ§ç³»ç»Ÿæ€§èƒ½
```

**ğŸ“š æ‰©å±•å­¦ä¹ æ–¹å‘**ï¼š
- **æœåŠ¡å‘ç°**ï¼šå­¦ä¹ Kubernetesã€Consulç­‰åŠ¨æ€å‘ç°
- **å‘Šè­¦è§„åˆ™**ï¼šåŸºäºé™æ€é…ç½®è®¾ç½®å‘Šè­¦
- **æ•°æ®æŸ¥è¯¢**ï¼šä½¿ç”¨PromQLæŸ¥è¯¢ç›‘æ§æ•°æ®
- **å¯è§†åŒ–**ï¼šé…åˆGrafanaå±•ç¤ºç›‘æ§å›¾è¡¨

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é™æ€é…ç½®æ‰‹å·¥ç»´æŠ¤ï¼Œç›®æ ‡åˆ—è¡¨è¦å†™å…¨
- æ ‡ç­¾åˆ†ç±»ä¾¿æŸ¥è¯¢ï¼Œç¯å¢ƒéš”ç¦»æ˜¯å…³é”®  
- æ–‡ä»¶ç»„ç»‡è¦è§„èŒƒï¼Œç‰ˆæœ¬ç®¡ç†ä¸èƒ½å¿˜
- æ€§èƒ½ä¼˜åŒ–è°ƒé—´éš”ï¼Œæ•…éšœæ’æŸ¥æœ‰æ­¥éª¤