---
title: 8ã€Deploymentæ»šåŠ¨æ›´æ–°
---
## ğŸ“š ç›®å½•

1. [æ»šåŠ¨æ›´æ–°åŸºæœ¬æ¦‚å¿µ](#1-æ»šåŠ¨æ›´æ–°åŸºæœ¬æ¦‚å¿µ)
2. [é•œåƒæ›´æ–°æ ¸å¿ƒæ“ä½œ](#2-é•œåƒæ›´æ–°æ ¸å¿ƒæ“ä½œ)
3. [æ›´æ–°å†å²ç®¡ç†](#3-æ›´æ–°å†å²ç®¡ç†)
4. [å›æ»šæ“ä½œè¯¦è§£](#4-å›æ»šæ“ä½œè¯¦è§£)
5. [æ›´æ–°è¿‡ç¨‹æ§åˆ¶](#5-æ›´æ–°è¿‡ç¨‹æ§åˆ¶)
6. [å¼ºåˆ¶æ›´æ–°æŠ€å·§](#6-å¼ºåˆ¶æ›´æ–°æŠ€å·§)
7. [ReplicaSetç®¡ç†](#7-ReplicaSetç®¡ç†)
8. [å®æˆ˜æ“ä½œæ¼”ç»ƒ](#8-å®æˆ˜æ“ä½œæ¼”ç»ƒ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ æ»šåŠ¨æ›´æ–°åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ»šåŠ¨æ›´æ–°


**æ»šåŠ¨æ›´æ–°**å°±åƒæ˜¯ç»™æ­£åœ¨è¿è¡Œçš„åº”ç”¨æ¢è¡£æœï¼Œ**ä¸åœæœºã€ä¸ä¸­æ–­æœåŠ¡**åœ°é€æ­¥æ›´æ–°åº”ç”¨ç‰ˆæœ¬ã€‚

```
ä¼ ç»Ÿæ›´æ–°æ–¹å¼ï¼š
æ—§åº”ç”¨ â†’ å…¨éƒ¨åœæ­¢ â†’ éƒ¨ç½²æ–°ç‰ˆæœ¬ â†’ å¯åŠ¨æ–°åº”ç”¨
âŒ é—®é¢˜ï¼šæœåŠ¡ä¸­æ–­ï¼Œç”¨æˆ·æ— æ³•è®¿é—®

æ»šåŠ¨æ›´æ–°æ–¹å¼ï¼š
Pod1(æ—§) Pod2(æ—§) Pod3(æ—§)  â† åŸæ¥3ä¸ªæ—§ç‰ˆæœ¬Pod
   â†“      â†“      â†“
Pod1(æ–°) Pod2(æ—§) Pod3(æ—§)  â† å…ˆæ›´æ–°1ä¸ª
   â†“      â†“      â†“
Pod1(æ–°) Pod2(æ–°) Pod3(æ—§)  â† å†æ›´æ–°1ä¸ª
   â†“      â†“      â†“
Pod1(æ–°) Pod2(æ–°) Pod3(æ–°)  â† å…¨éƒ¨æ›´æ–°å®Œæˆ
âœ… ä¼˜åŠ¿ï¼šæœåŠ¡ä¸ä¸­æ–­ï¼Œå¹³æ»‘è¿‡æ¸¡
```

### 1.2 æ»šåŠ¨æ›´æ–°çš„å·¥ä½œåŸç†


> ğŸ’¡ **æ ¸å¿ƒåŸç†**ï¼šKubernetesé€šè¿‡ReplicaSetæ¥ç®¡ç†ä¸åŒç‰ˆæœ¬çš„Podï¼Œæ–°æ—§ç‰ˆæœ¬é€æ­¥æ›¿æ¢

**å·¥ä½œæµç¨‹å›¾ç¤ºï¼š**
```
Deployment
    â”œâ”€â”€ ReplicaSet-v1 (æ—§ç‰ˆæœ¬)
    â”‚   â”œâ”€â”€ Pod-v1-1 âœ… â†’ âŒ (é€æ­¥åˆ é™¤)
    â”‚   â”œâ”€â”€ Pod-v1-2 âœ… â†’ âŒ
    â”‚   â””â”€â”€ Pod-v1-3 âœ… â†’ âŒ
    â”‚
    â””â”€â”€ ReplicaSet-v2 (æ–°ç‰ˆæœ¬)
        â”œâ”€â”€ Pod-v2-1 âŒ â†’ âœ… (é€æ­¥åˆ›å»º)
        â”œâ”€â”€ Pod-v2-2 âŒ â†’ âœ…
        â””â”€â”€ Pod-v2-3 âŒ â†’ âœ…
```

### 1.3 æ»šåŠ¨æ›´æ–°çš„ä¼˜åŠ¿


| **ä¼˜åŠ¿** | **è¯´æ˜** | **å®é™…æ•ˆæœ** |
|---------|---------|-------------|
| â­ **é›¶åœæœº** | æœåŠ¡æŒç»­å¯ç”¨ | ç”¨æˆ·æ— æ„ŸçŸ¥æ›´æ–° |
| â­ **æ¸è¿›å¼** | é€æ­¥æ›¿æ¢Pod | é£é™©å¯æ§ |
| â­ **å¯å›æ»š** | æ”¯æŒç‰ˆæœ¬å›é€€ | å‡ºé—®é¢˜èƒ½å¿«é€Ÿæ¢å¤ |
| â­ **èµ„æºæ§åˆ¶** | æ§åˆ¶åŒæ—¶æ›´æ–°çš„Podæ•°é‡ | é¿å…èµ„æºå‹åŠ›è¿‡å¤§ |

---

## 2. ğŸ–¼ï¸ é•œåƒæ›´æ–°æ ¸å¿ƒæ“ä½œ


### 2.1 é•œåƒæ›´æ–°åŸºæœ¬å‘½ä»¤


**æœ€å¸¸ç”¨çš„æ›´æ–°é•œåƒå‘½ä»¤ï¼š**
```bash
kubectl set image deployment/[deploymentåç§°] [å®¹å™¨åç§°]=[æ–°é•œåƒ]
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šè¿™ä¸ªå‘½ä»¤å°±æ˜¯å‘Šè¯‰Kubernetes"æŠŠè¿™ä¸ªåº”ç”¨çš„é•œåƒæ¢æˆæ–°çš„"

### 2.2 å®é™…æ“ä½œç¤ºä¾‹


**åœºæ™¯ï¼šå°†nginxåº”ç”¨ä»1.19ç‰ˆæœ¬æ›´æ–°åˆ°1.20ç‰ˆæœ¬**

```bash
# â‘  æŸ¥çœ‹å½“å‰DeploymentçŠ¶æ€
kubectl get deployment nginx-app

# â‘¡ æ›´æ–°é•œåƒç‰ˆæœ¬
kubectl set image deployment/nginx-app nginx=nginx:1.20

# â‘¢ æŸ¥çœ‹æ›´æ–°è¿‡ç¨‹
kubectl get pods -w
# -w å‚æ•°è¡¨ç¤ºæŒç»­ç›‘æ§ï¼Œèƒ½çœ‹åˆ°Podçš„åˆ›å»ºå’Œåˆ é™¤è¿‡ç¨‹
```

**æ›´æ–°è¿‡ç¨‹å®æ—¶æ˜¾ç¤ºï¼š**
```
NAME                        READY   STATUS    
nginx-app-v1-12345         1/1     Running   â† æ—§ç‰ˆæœ¬Pod
nginx-app-v1-67890         1/1     Running   â† æ—§ç‰ˆæœ¬Pod
nginx-app-v2-11111         0/1     Pending   â† æ–°ç‰ˆæœ¬Podå¼€å§‹åˆ›å»º
nginx-app-v2-11111         1/1     Running   â† æ–°ç‰ˆæœ¬Podè¿è¡Œ
nginx-app-v1-12345         1/1     Terminating â† æ—§ç‰ˆæœ¬Podå¼€å§‹åˆ é™¤
```

### 2.3 å¤šå®¹å™¨æ›´æ–°


**å¦‚æœä¸€ä¸ªPodé‡Œæœ‰å¤šä¸ªå®¹å™¨ï¼š**
```bash
# æ›´æ–°æŒ‡å®šå®¹å™¨
kubectl set image deployment/my-app nginx=nginx:1.20 redis=redis:6.0

# æŸ¥çœ‹å½“å‰æ‰€æœ‰å®¹å™¨é•œåƒ
kubectl describe deployment my-app | grep Image
```

### 2.4 æ›´æ–°çŠ¶æ€æ£€æŸ¥


```bash
# æ£€æŸ¥æ›´æ–°çŠ¶æ€
kubectl rollout status deployment/nginx-app

# æ˜¾ç¤ºç»“æœç¤ºä¾‹ï¼š
# deployment "nginx-app" successfully rolled out â† æ›´æ–°æˆåŠŸ
# Waiting for deployment "nginx-app" rollout to finish... â† æ›´æ–°ä¸­
```

---

## 3. ğŸ“‹ æ›´æ–°å†å²ç®¡ç†


### 3.1 æŸ¥çœ‹æ›´æ–°å†å²


**æŸ¥çœ‹Deploymentçš„æ‰€æœ‰å†å²ç‰ˆæœ¬ï¼š**
```bash
kubectl rollout history deployment/nginx-app
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
REVISION  CHANGE-CAUSE
1         <none>
2         kubectl set image deployment/nginx-app nginx=nginx:1.20
3         kubectl set image deployment/nginx-app nginx=nginx:1.21
```

> ğŸ“ **ç‰ˆæœ¬è¯´æ˜**ï¼š
> - **REVISION**ï¼šç‰ˆæœ¬å·ï¼Œæ•°å­—è¶Šå¤§è¡¨ç¤ºè¶Šæ–°çš„ç‰ˆæœ¬
> - **CHANGE-CAUSE**ï¼šæ›´æ–°åŸå› ï¼Œè®°å½•æ˜¯ä»€ä¹ˆæ“ä½œå¯¼è‡´çš„æ›´æ–°

### 3.2 æ·»åŠ æ›´æ–°è¯´æ˜


**è®©æ›´æ–°å†å²æ›´æ¸…æ¥šï¼Œæ·»åŠ è¯´æ˜ä¿¡æ¯ï¼š**
```bash
# æ–¹æ³•1ï¼šæ›´æ–°æ—¶æ·»åŠ æ³¨é‡Š
kubectl set image deployment/nginx-app nginx=nginx:1.20 \
  --record=true

# æ–¹æ³•2ï¼šæ‰‹åŠ¨æ·»åŠ æ³¨é‡Š
kubectl annotate deployment/nginx-app \
  deployment.kubernetes.io/change-cause="å‡çº§åˆ°nginx 1.20ç‰ˆæœ¬"
```

### 3.3 æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬è¯¦æƒ…


```bash
# æŸ¥çœ‹ç‰ˆæœ¬2çš„å…·ä½“é…ç½®
kubectl rollout history deployment/nginx-app --revision=2
```

**è¯¦æƒ…è¾“å‡ºç¤ºä¾‹ï¼š**
```
deployment.apps/nginx-app with revision #2
Pod Template:
  Labels:       app=nginx-app
  Containers:
   nginx:
    Image:      nginx:1.20    â† è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨çš„é•œåƒ
    Port:       80/TCP
    ...
```

---

## 4. â†©ï¸ å›æ»šæ“ä½œè¯¦è§£


### 4.1 ä»€ä¹ˆæ—¶å€™éœ€è¦å›æ»š


> âš ï¸ **å›æ»šåœºæ™¯**ï¼š
> - æ–°ç‰ˆæœ¬æœ‰Bugï¼Œå½±å“ä¸šåŠ¡
> - æ–°ç‰ˆæœ¬æ€§èƒ½ä¸‹é™
> - æ–°ç‰ˆæœ¬ä¸å…¼å®¹ç°æœ‰ç³»ç»Ÿ
> - ç´§æ€¥æƒ…å†µéœ€è¦å¿«é€Ÿæ¢å¤

### 4.2 å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬


**æœ€ç®€å•çš„å›æ»šæ“ä½œï¼š**
```bash
# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/nginx-app
```

**å›æ»šè¿‡ç¨‹è¯´æ˜ï¼š**
```
å½“å‰ç‰ˆæœ¬ï¼šVersion 3 (nginx:1.21)
ä¸Šä¸€ç‰ˆæœ¬ï¼šVersion 2 (nginx:1.20)  â† å›æ»šç›®æ ‡
æ›´æ—©ç‰ˆæœ¬ï¼šVersion 1 (nginx:1.19)

æ‰§è¡Œå›æ»šåï¼šnginx:1.21 â†’ nginx:1.20
```

### 4.3 å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬


```bash
# å›æ»šåˆ°æŒ‡å®šçš„ç‰ˆæœ¬å·
kubectl rollout undo deployment/nginx-app --to-revision=1

# è¿™ä¼šæŠŠåº”ç”¨å›æ»šåˆ°ç‰ˆæœ¬1çš„çŠ¶æ€
```

### 4.4 å›æ»šçŠ¶æ€ç›‘æ§


```bash
# ç›‘æ§å›æ»šè¿‡ç¨‹
kubectl rollout status deployment/nginx-app

# æŸ¥çœ‹å›æ»šåçš„PodçŠ¶æ€
kubectl get pods -l app=nginx-app
```

**å›æ»šè¿‡ç¨‹å®æ—¶æ˜¾ç¤ºï¼š**
```
nginx-app-v3-12345  1/1  Running â†’ Terminating  â† æ–°ç‰ˆæœ¬Podè¢«åˆ é™¤
nginx-app-v2-67890  0/1  Pending â†’ Running      â† æ—§ç‰ˆæœ¬Podè¢«é‡å»º
```

---

## 5. â¸ï¸ æ›´æ–°è¿‡ç¨‹æ§åˆ¶


### 5.1 æš‚åœå’Œæ¢å¤æ›´æ–°


**æœ‰æ—¶éœ€è¦æš‚åœæ›´æ–°è¿‡ç¨‹ï¼š**

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼š
> - å‘ç°æ›´æ–°è¿‡ç¨‹ä¸­æœ‰é—®é¢˜ï¼Œéœ€è¦æš‚åœæ£€æŸ¥
> - éœ€è¦è§‚å¯Ÿéƒ¨åˆ†Podçš„è¿è¡Œæƒ…å†µ
> - åˆ†æ‰¹æ¬¡æ§åˆ¶æ›´æ–°èŠ‚å¥

```bash
# æš‚åœæ»šåŠ¨æ›´æ–°
kubectl rollout pause deployment/nginx-app

# æ¢å¤æ»šåŠ¨æ›´æ–°
kubectl rollout resume deployment/nginx-app
```

### 5.2 æš‚åœæ›´æ–°çš„å®é™…æ•ˆæœ


**æš‚åœæ›´æ–°çŠ¶æ€ç¤ºä¾‹ï¼š**
```
æ›´æ–°å‰ï¼š3ä¸ªæ—§ç‰ˆæœ¬Pod
æ›´æ–°å¼€å§‹ï¼š2ä¸ªæ—§ç‰ˆæœ¬Pod + 1ä¸ªæ–°ç‰ˆæœ¬Pod
æ‰§è¡Œæš‚åœï¼šä¿æŒå½“å‰çŠ¶æ€ä¸å˜  â† æš‚åœåœ¨è¿™é‡Œ
æ¢å¤æ›´æ–°ï¼šç»§ç»­æ›¿æ¢å‰©ä½™çš„æ—§ç‰ˆæœ¬Pod
```

### 5.3 é‡å¯Deployment


**å¼ºåˆ¶é‡å¯æ‰€æœ‰Podï¼š**
```bash
kubectl rollout restart deployment/nginx-app
```

> ğŸ“ **é‡å¯è¯´æ˜**ï¼šè¿™ä¸ªå‘½ä»¤ä¼šè§¦å‘æ‰€æœ‰Podçš„é‡å»ºï¼Œä½†ä¸æ”¹å˜é•œåƒç‰ˆæœ¬

**é‡å¯åº”ç”¨åœºæ™¯ï¼š**
- åº”ç”¨å‡ºç°å†…å­˜æ³„æ¼éœ€è¦é‡å¯
- é…ç½®æ›´æ–°éœ€è¦é‡å¯ç”Ÿæ•ˆ
- æ¸…ç†åº”ç”¨ç¼“å­˜

---

## 6. ğŸ”§ å¼ºåˆ¶æ›´æ–°æŠ€å·§


### 6.1 ä»€ä¹ˆæ˜¯å¼ºåˆ¶æ›´æ–°


> ğŸ’¡ **å¼ºåˆ¶æ›´æ–°åœºæ™¯**ï¼šå½“é•œåƒæ ‡ç­¾ç›¸åŒä½†å†…å®¹å·²æ›´æ–°æ—¶ï¼ˆå¦‚ä½¿ç”¨latestæ ‡ç­¾ï¼‰

**é—®é¢˜ç¤ºä¾‹ï¼š**
```
åŸæ¥éƒ¨ç½²ï¼šnginx:latest (å®é™…æ˜¯nginx:1.19)
é•œåƒä»“åº“æ›´æ–°ï¼šnginx:latest (å®é™…å˜æˆnginx:1.20)
é—®é¢˜ï¼šKubernetesè®¤ä¸ºé•œåƒæ²¡å˜ï¼Œä¸ä¼šæ›´æ–°Pod
```

### 6.2 å¼ºåˆ¶æ›´æ–°å‘½ä»¤


```bash
# æ–¹æ³•1ï¼šæ·»åŠ æ—¶é—´æˆ³æ³¨é‡Šå¼ºåˆ¶æ›´æ–°
kubectl patch deployment nginx-app -p \
'{"spec":{"template":{"metadata":{"annotations":{"date":"'$(date)'"}}}}'
```

**å‘½ä»¤è§£é‡Šï¼š**
- `patch`ï¼šä¿®è¡¥å‘½ä»¤ï¼Œç”¨äºå±€éƒ¨æ›´æ–°
- é€šè¿‡æ·»åŠ å½“å‰æ—¶é—´çš„æ³¨é‡Šï¼Œè®©Kubernetesè®¤ä¸ºPodæ¨¡æ¿å‘ç”Ÿäº†å˜åŒ–
- ä»è€Œè§¦å‘æ»šåŠ¨æ›´æ–°

### 6.3 å…¶ä»–å¼ºåˆ¶æ›´æ–°æ–¹æ³•


```bash
# æ–¹æ³•2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
kubectl set env deployment/nginx-app RESTART_TIME=$(date)

# æ–¹æ³•3ï¼šç›´æ¥é‡å¯
kubectl rollout restart deployment/nginx-app
```

---

## 7. ğŸ“¦ ReplicaSetç®¡ç†


### 7.1 ç†è§£ReplicaSetçš„ä½œç”¨


> ğŸ’¡ **ReplicaSetç®€å•ç†è§£**ï¼šå®ƒæ˜¯Deploymentçš„"æ‰§è¡Œè€…"ï¼Œè´Ÿè´£ç®¡ç†å…·ä½“çš„Pod

**å±‚æ¬¡å…³ç³»ï¼š**
```
Deployment (ç­–ç•¥ç®¡ç†è€…)
    â””â”€â”€ ReplicaSet (å…·ä½“æ‰§è¡Œè€…)
            â””â”€â”€ Pod (å®é™…å·¥ä½œè€…)
```

### 7.2 æŸ¥çœ‹ReplicaSet


```bash
# æŸ¥çœ‹æ‰€æœ‰ReplicaSet
kubectl get rs

# æŸ¥çœ‹ç‰¹å®šåº”ç”¨çš„ReplicaSet
kubectl get rs -l app=nginx-app
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
NAME               DESIRED   CURRENT   READY   AGE
nginx-app-6b7d4c   0         0         0       2d    â† æ—§ç‰ˆæœ¬RSï¼ŒPodæ•°ä¸º0
nginx-app-8f9a2b   3         3         3       1h    â† å½“å‰ç‰ˆæœ¬RSï¼ŒPodæ•°ä¸º3
```

### 7.3 ReplicaSetè¯¦ç»†ä¿¡æ¯


```bash
# æŸ¥çœ‹ReplicaSetè¯¦æƒ…
kubectl describe rs nginx-app-8f9a2b
```

**é‡è¦ä¿¡æ¯åŒ…æ‹¬ï¼š**
- **Podæ¨¡æ¿**ï¼šä½¿ç”¨çš„é•œåƒç‰ˆæœ¬
- **PodçŠ¶æ€**ï¼šå½“å‰è¿è¡Œçš„Podæƒ…å†µ
- **äº‹ä»¶æ—¥å¿—**ï¼šåˆ›å»ºå’Œç®¡ç†Podçš„è¿‡ç¨‹

### 7.4 æ¸…ç†æ—§ç‰ˆæœ¬ReplicaSet


> âš ï¸ **æ³¨æ„**ï¼šKubernetesä¼šè‡ªåŠ¨ä¿ç•™ä¸€å®šæ•°é‡çš„å†å²ReplicaSetç”¨äºå›æ»š

```bash
# è®¾ç½®ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°é‡
kubectl patch deployment nginx-app -p \
'{"spec":{"revisionHistoryLimit":5}}'
```

---

## 8. ğŸ› ï¸ å®æˆ˜æ“ä½œæ¼”ç»ƒ


### 8.1 å®Œæ•´æ›´æ–°æµç¨‹æ¼”ç¤º


**åœºæ™¯ï¼šå°†nginxåº”ç”¨ä»1.19æ›´æ–°åˆ°1.20ï¼Œå†å›æ»šåˆ°1.19**

**æ­¥éª¤â‘  å‡†å¤‡å·¥ä½œ**
```bash
# åˆ›å»ºæµ‹è¯•Deployment
kubectl create deployment nginx-demo --image=nginx:1.19
kubectl scale deployment nginx-demo --replicas=3
```

**æ­¥éª¤â‘¡ æ‰§è¡Œæ›´æ–°**
```bash
# æ›´æ–°é•œåƒç‰ˆæœ¬
kubectl set image deployment/nginx-demo nginx=nginx:1.20 --record

# ç›‘æ§æ›´æ–°è¿‡ç¨‹
kubectl rollout status deployment/nginx-demo
```

**æ­¥éª¤â‘¢ éªŒè¯æ›´æ–°ç»“æœ**
```bash
# æ£€æŸ¥Podé•œåƒç‰ˆæœ¬
kubectl describe pods -l app=nginx-demo | grep Image

# æŸ¥çœ‹æ›´æ–°å†å²
kubectl rollout history deployment/nginx-demo
```

**æ­¥éª¤â‘£ æ¨¡æ‹Ÿé—®é¢˜å›æ»š**
```bash
# å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
kubectl rollout undo deployment/nginx-demo

# éªŒè¯å›æ»šç»“æœ
kubectl rollout status deployment/nginx-demo
```

### 8.2 æ›´æ–°ç­–ç•¥é…ç½®


**æ§åˆ¶æ›´æ–°é€Ÿåº¦å’Œå¹¶å‘æ•°ï¼š**
```bash
# æŸ¥çœ‹å½“å‰æ›´æ–°ç­–ç•¥
kubectl describe deployment nginx-demo | grep -A5 "RollingUpdateStrategy"
```

**å…¸å‹è¾“å‡ºï¼š**
```
RollingUpdateStrategy:  25% max unavailable, 25% max surge
```

> ğŸ“ **ç­–ç•¥è§£é‡Š**ï¼š
> - **max unavailable**: æœ€å¤š25%çš„Podå¯ä»¥ä¸å¯ç”¨
> - **max surge**: æœ€å¤šé¢å¤–åˆ›å»º25%çš„Pod

### 8.3 æ›´æ–°å¼‚å¸¸å¤„ç†


**å¦‚æœæ›´æ–°å¡ä½äº†ï¼š**
```bash
# æ£€æŸ¥æ›´æ–°çŠ¶æ€
kubectl rollout status deployment/nginx-demo --timeout=300s

# å¦‚æœè¶…æ—¶ï¼Œæ£€æŸ¥PodçŠ¶æ€
kubectl get pods -l app=nginx-demo

# æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯æ‰¾å‡ºé—®é¢˜
kubectl describe pod <pod-name>
```

**å¸¸è§é—®é¢˜åŠè§£å†³ï¼š**
| **é—®é¢˜** | **ç°è±¡** | **è§£å†³æ–¹æ³•** |
|---------|---------|-------------|
| ğŸ”´ é•œåƒæ‹‰å–å¤±è´¥ | PodçŠ¶æ€ImagePullBackOff | æ£€æŸ¥é•œåƒåç§°å’Œç½‘ç»œ |
| ğŸŸ¡ èµ„æºä¸è¶³ | PodçŠ¶æ€Pending | æ£€æŸ¥èŠ‚ç‚¹èµ„æº |
| ğŸŸ  é…ç½®é”™è¯¯ | PodçŠ¶æ€CrashLoopBackOff | æ£€æŸ¥å®¹å™¨é…ç½® |

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå‘½ä»¤


```bash
# ğŸ”¥ æœ€é‡è¦çš„5ä¸ªå‘½ä»¤
kubectl set image deployment/<name> <container>=<image>  # æ›´æ–°é•œåƒ
kubectl rollout status deployment/<name>                 # æ£€æŸ¥æ›´æ–°çŠ¶æ€
kubectl rollout history deployment/<name>               # æŸ¥çœ‹å†å²ç‰ˆæœ¬
kubectl rollout undo deployment/<name>                  # å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
kubectl rollout restart deployment/<name>               # é‡å¯åº”ç”¨
```

### 9.2 æ»šåŠ¨æ›´æ–°æ ¸å¿ƒæ¦‚å¿µ


> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**ï¼šæ»šåŠ¨æ›´æ–°æ˜¯Kuberneteså®ç°é›¶åœæœºéƒ¨ç½²çš„æ ¸å¿ƒæœºåˆ¶

**å…³é”®ç†è§£ç‚¹ï¼š**
- **ReplicaSetç®¡ç†**ï¼šæ¯æ¬¡æ›´æ–°åˆ›å»ºæ–°çš„ReplicaSet
- **æ¸è¿›æ›¿æ¢**ï¼šé€æ­¥ç”¨æ–°Podæ›¿æ¢æ—§Pod
- **çŠ¶æ€ä¿æŒ**ï¼šå§‹ç»ˆä¿è¯è¶³å¤Ÿæ•°é‡çš„Podæä¾›æœåŠ¡
- **å¯å›æ»šæ€§**ï¼šä¿ç•™å†å²ç‰ˆæœ¬æ”¯æŒå¿«é€Ÿå›æ»š

### 9.3 æ“ä½œæœ€ä½³å®è·µ


**ğŸ”¸ æ›´æ–°å‰å‡†å¤‡**
- âœ… å¤‡ä»½é‡è¦æ•°æ®
- âœ… å‡†å¤‡å›æ»šè®¡åˆ’
- âœ… éªŒè¯æ–°é•œåƒåŠŸèƒ½

**ğŸ”¸ æ›´æ–°è¿‡ç¨‹ç›‘æ§**
- âœ… ä½¿ç”¨`-w`å‚æ•°ç›‘æ§PodçŠ¶æ€
- âœ… æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
- âœ… è§‚å¯Ÿä¸šåŠ¡æŒ‡æ ‡å˜åŒ–

**ğŸ”¸ æ›´æ–°åéªŒè¯**
- âœ… åŠŸèƒ½æµ‹è¯•éªŒè¯
- âœ… æ€§èƒ½æŒ‡æ ‡æ£€æŸ¥
- âœ… ç”¨æˆ·è®¿é—®æ­£å¸¸

### 9.4 å¸¸è§è¯¯åŒºé¿å…


| **è¯¯åŒº** | **æ­£ç¡®ç†è§£** | **å»ºè®®æ“ä½œ** |
|---------|-------------|-------------|
| âŒ ç›´æ¥åˆ é™¤Podæ¥æ›´æ–° | åº”è¯¥æ›´æ–°Deployment | ä½¿ç”¨`kubectl set image` |
| âŒ å¿½ç•¥æ›´æ–°è¿‡ç¨‹ç›‘æ§ | éœ€è¦ç›‘æ§æ›´æ–°çŠ¶æ€ | ä½¿ç”¨`kubectl rollout status` |
| âŒ ä¸ä¿ç•™æ›´æ–°å†å² | å†å²ç‰ˆæœ¬ç”¨äºå›æ»š | è®¾ç½®åˆé€‚çš„`revisionHistoryLimit` |
| âŒ æ›´æ–°åä¸éªŒè¯ | å¿…é¡»éªŒè¯åŠŸèƒ½æ­£å¸¸ | æ‰§è¡ŒåŠŸèƒ½å’Œæ€§èƒ½æµ‹è¯• |

### 9.5 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ æ–°æ‰‹å­¦ä¹ è·¯å¾„**
1. **ç†è§£æ¦‚å¿µ** â†’ æŒæ¡æ»šåŠ¨æ›´æ–°åŸç†
2. **åŸºç¡€æ“ä½œ** â†’ ç»ƒä¹ é•œåƒæ›´æ–°å‘½ä»¤
3. **ç›‘æ§æŠ€èƒ½** â†’ å­¦ä¼šæŸ¥çœ‹æ›´æ–°çŠ¶æ€
4. **æ•…éšœå¤„ç†** â†’ æŒæ¡å›æ»šæ“ä½œ
5. **é«˜çº§æŠ€å·§** â†’ å­¦ä¹ æ›´æ–°ç­–ç•¥è°ƒä¼˜

**ğŸ”§ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨**
- æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯æ›´æ–°æµç¨‹
- ä½¿ç”¨`--record`è®°å½•æ›´æ–°å†å²
- è®¾ç½®åˆç†çš„æ›´æ–°ç­–ç•¥
- å»ºç«‹ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- å‡†å¤‡åº”æ€¥å›æ»šé¢„æ¡ˆ

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
```
æ»šåŠ¨æ›´æ–°ä¸åœæœºï¼Œé€æ­¥æ›¿æ¢ä¿æœåŠ¡
set imageæ›´æ–°ç‰ˆï¼Œrolloutç®¡ç†å…¨è¿‡ç¨‹
historyçœ‹å†å²ï¼Œundoå¿«é€Ÿèƒ½å›æ»š
ç›‘æ§çŠ¶æ€å¾ˆé‡è¦ï¼Œå‡ºé”™å›æ»šä¸æ…Œå¼ 
```