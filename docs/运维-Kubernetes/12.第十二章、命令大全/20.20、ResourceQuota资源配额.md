---
title: 20ã€ResourceQuotaèµ„æºé…é¢
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯èµ„æºé…é¢](#1-ä»€ä¹ˆæ˜¯èµ„æºé…é¢)
2. [ResourceQuotaåŸºç¡€æ“ä½œ](#2-resourcequotaåŸºç¡€æ“ä½œ)
3. [èµ„æºé…é¢ç±»å‹è¯¦è§£](#3-èµ„æºé…é¢ç±»å‹è¯¦è§£)
4. [LimitRangeé™åˆ¶èŒƒå›´](#4-limitrangeé™åˆ¶èŒƒå›´)
5. [èµ„æºç›‘æ§ä¸ç®¡ç†](#5-èµ„æºç›‘æ§ä¸ç®¡ç†)
6. [å®æˆ˜åœºæ™¯åº”ç”¨](#6-å®æˆ˜åœºæ™¯åº”ç”¨)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯èµ„æºé…é¢


### 1.1 é€šä¿—ç†è§£èµ„æºé…é¢


**ç®€å•æ¯”å–»**ï¼šå°±åƒç»™æ¯ä¸ªéƒ¨é—¨åˆ†é…é¢„ç®—ä¸€æ ·
```
å…¬å¸æ¯”å–»ï¼š                    Kubernetesé›†ç¾¤ï¼š
â”œâ”€â”€ ç ”å‘éƒ¨é—¨ (é¢„ç®—100ä¸‡)      â”œâ”€â”€ namespace-dev (CPU: 2æ ¸, å†…å­˜: 4G)
â”œâ”€â”€æµ‹è¯•éƒ¨é—¨ (é¢„ç®—50ä¸‡)       â”œâ”€â”€ namespace-test (CPU: 1æ ¸, å†…å­˜: 2G)  
â””â”€â”€è¿ç»´éƒ¨é—¨ (é¢„ç®—30ä¸‡)       â””â”€â”€ namespace-ops (CPU: 0.5æ ¸, å†…å­˜: 1G)

ç›®çš„ï¼šé˜²æ­¢æŸä¸ªéƒ¨é—¨æŠŠé’±èŠ±å…‰ï¼Œå½±å“å…¶ä»–éƒ¨é—¨æ­£å¸¸è¿è¡Œ
```

**ResourceQuotaçš„æœ¬è´¨ä½œç”¨**ï¼š
- ğŸ›¡ï¸ **é˜²æ­¢èµ„æºæ»¥ç”¨**ï¼šæŸä¸ªåº”ç”¨å ç”¨è¿‡å¤šèµ„æº
- ğŸ¯ **åˆç†åˆ†é…èµ„æº**ï¼šç¡®ä¿æ¯ä¸ªå›¢é˜Ÿéƒ½èƒ½è·å¾—åº”æœ‰çš„èµ„æº
- ğŸ’° **æˆæœ¬æ§åˆ¶**ï¼šé¿å…äº‘æœåŠ¡è´¹ç”¨å¤±æ§
- ğŸ”’ **å¤šç§Ÿæˆ·éš”ç¦»**ï¼šä¸åŒé¡¹ç›®é—´èµ„æºäº’ä¸å½±å“

### 1.2 ResourceQuotaå·¥ä½œåŸç†


**å·¥ä½œæœºåˆ¶å›¾ç¤º**ï¼š
```
ç”¨æˆ·åˆ›å»ºPodè¯·æ±‚
       â†“
Kubernetesæ£€æŸ¥å½“å‰namespaceçš„ResourceQuota
       â†“
  [èµ„æºå¤Ÿç”¨ï¼Ÿ]
    â†“     â†“
   YES    NO
    â†“     â†“
 åˆ›å»ºPod  æ‹’ç»åˆ›å»º
```

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
- **Hard Limit**ï¼šç¡¬æ€§é™åˆ¶ï¼Œä¸å¯è¶…è¶Š
- **Used**ï¼šå½“å‰å·²ä½¿ç”¨çš„èµ„æºé‡
- **Request vs Limit**ï¼šè¯·æ±‚é‡ä¸é™åˆ¶é‡çš„åŒºåˆ«

---

## 2. ğŸ› ï¸ ResourceQuotaåŸºç¡€æ“ä½œ


### 2.1 åˆ›å»ºèµ„æºé…é¢


**ğŸ“ æœ€åŸºæœ¬çš„åˆ›å»ºæ–¹å¼**

```bash
# åˆ›å»ºä¸€ä¸ªç®€å•çš„èµ„æºé…é¢ï¼ˆCPU 1æ ¸ï¼Œå†…å­˜1Gï¼Œæœ€å¤š2ä¸ªPodï¼‰
kubectl create quota my-quota --hard=cpu=1,memory=1G,pods=2

# åˆ›å»ºåç«‹å³æŸ¥çœ‹
kubectl get resourcequota
```

**ğŸ’¡ å‚æ•°å«ä¹‰è§£é‡Š**ï¼š
- `quota`ï¼šèµ„æºé…é¢å¯¹è±¡ç±»å‹
- `my-quota`ï¼šé…é¢çš„åç§°ï¼ˆå¯ä»¥è‡ªå®šä¹‰ï¼‰
- `--hard`ï¼šç¡¬æ€§é™åˆ¶å‚æ•°
- `cpu=1`ï¼šCPUé™åˆ¶1æ ¸å¿ƒ
- `memory=1G`ï¼šå†…å­˜é™åˆ¶1GB
- `pods=2`ï¼šæœ€å¤šåˆ›å»º2ä¸ªPod

### 2.2 æŸ¥çœ‹èµ„æºé…é¢


**ğŸ“Š æŸ¥çœ‹é…é¢åˆ—è¡¨**

```bash
# æŸ¥çœ‹å½“å‰namespaceçš„æ‰€æœ‰èµ„æºé…é¢
kubectl get resourcequota

# æŸ¥çœ‹æ‰€æœ‰namespaceçš„é…é¢
kubectl get resourcequota --all-namespaces
```

**è¾“å‡ºç¤ºä¾‹è§£è¯»**ï¼š
```
NAME       AGE   REQUEST                         LIMIT
my-quota   5m    cpu: 0/1, memory: 0/1Gi, pods: 0/2   cpu: 0/1, memory: 0/1Gi
           â†‘     â†‘                               â†‘
         åç§°   å·²ä½¿ç”¨/æ€»é™åˆ¶                    èµ„æºé™åˆ¶
```

### 2.3 æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯


**ğŸ” è¯¦ç»†ä¿¡æ¯æŸ¥çœ‹**

```bash
# æŸ¥çœ‹é…é¢çš„è¯¦ç»†ä¿¡æ¯
kubectl describe resourcequota my-quota
```

**è¯¦ç»†è¾“å‡ºè§£è¯»**ï¼š
```
Name:       my-quota
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     1        # CPUä½¿ç”¨æƒ…å†µï¼šå·²ç”¨0æ ¸/é™åˆ¶1æ ¸
memory      0     1Gi      # å†…å­˜ä½¿ç”¨æƒ…å†µï¼šå·²ç”¨0/é™åˆ¶1GB  
pods        0     2        # Podæ•°é‡ï¼šå·²ç”¨0ä¸ª/é™åˆ¶2ä¸ª
```

### 2.4 ä¿®æ”¹èµ„æºé…é¢


**âœï¸ åŠ¨æ€è°ƒæ•´é…é¢**

```bash
# ä½¿ç”¨patchå‘½ä»¤å¢åŠ Podæ•°é‡é™åˆ¶åˆ°5ä¸ª
kubectl patch resourcequota my-quota --type='merge' -p='{"spec":{"hard":{"pods":"5"}}}'

# éªŒè¯ä¿®æ”¹ç»“æœ
kubectl describe resourcequota my-quota
```

**ğŸ¯ ä¿®æ”¹æŠ€å·§**ï¼š
- ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆ
- åªèƒ½ä¿®æ”¹hardé™åˆ¶ï¼Œä¸èƒ½ä¿®æ”¹usedå€¼
- å¯ä»¥åŒæ—¶ä¿®æ”¹å¤šä¸ªèµ„æºé™åˆ¶

### 2.5 åˆ é™¤èµ„æºé…é¢


```bash
# åˆ é™¤æŒ‡å®šçš„èµ„æºé…é¢
kubectl delete resourcequota my-quota

# ç¡®è®¤åˆ é™¤
kubectl get resourcequota
```

---

## 3. ğŸ“‹ èµ„æºé…é¢ç±»å‹è¯¦è§£


### 3.1 è®¡ç®—èµ„æºé…é¢


**ğŸ”§ CPUå’Œå†…å­˜é…é¢**

| é…é¢ç±»å‹ | å«ä¹‰ | ç¤ºä¾‹å€¼ | è¯´æ˜ |
|---------|------|-------|------|
| `requests.cpu` | CPUè¯·æ±‚æ€»å’Œ | `"2"` | æ‰€æœ‰Podçš„CPUè¯·æ±‚ä¹‹å’Œ |
| `limits.cpu` | CPUé™åˆ¶æ€»å’Œ | `"4"` | æ‰€æœ‰Podçš„CPUé™åˆ¶ä¹‹å’Œ |
| `requests.memory` | å†…å­˜è¯·æ±‚æ€»å’Œ | `"4Gi"` | æ‰€æœ‰Podçš„å†…å­˜è¯·æ±‚ä¹‹å’Œ |
| `limits.memory` | å†…å­˜é™åˆ¶æ€»å’Œ | `"8Gi"` | æ‰€æœ‰Podçš„å†…å­˜é™åˆ¶ä¹‹å’Œ |

**å®é™…åˆ›å»ºç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºè®¡ç®—èµ„æºé…é¢
kubectl create quota compute-quota \
  --hard=requests.cpu=2,requests.memory=4Gi,limits.cpu=4,limits.memory=8Gi
```

### 3.2 å¯¹è±¡æ•°é‡é…é¢


**ğŸ“Š Kuberneteså¯¹è±¡æ•°é‡é™åˆ¶**

```bash
# åˆ›å»ºå¯¹è±¡æ•°é‡é…é¢
kubectl create quota object-quota \
  --hard=pods=10,services=5,configmaps=3,secrets=3,persistentvolumeclaims=2
```

**å¸¸ç”¨å¯¹è±¡é…é¢**ï¼š
- `pods`ï¼šPodæ•°é‡é™åˆ¶
- `services`ï¼šServiceæ•°é‡é™åˆ¶  
- `configmaps`ï¼šConfigMapæ•°é‡é™åˆ¶
- `secrets`ï¼šSecretæ•°é‡é™åˆ¶
- `persistentvolumeclaims`ï¼šPVCæ•°é‡é™åˆ¶

### 3.3 å­˜å‚¨èµ„æºé…é¢


**ğŸ’¾ å­˜å‚¨ç›¸å…³é…é¢**

```bash
# åˆ›å»ºå­˜å‚¨é…é¢
kubectl create quota storage-quota \
  --hard=requests.storage=100Gi,persistentvolumeclaims=5
```

**å­˜å‚¨é…é¢ç±»å‹**ï¼š
- `requests.storage`ï¼šå­˜å‚¨è¯·æ±‚æ€»é‡
- `persistentvolumeclaims`ï¼šPVCæ•°é‡é™åˆ¶
- `requests.ephemeral-storage`ï¼šä¸´æ—¶å­˜å‚¨é™åˆ¶

---

## 4. ğŸšï¸ LimitRangeé™åˆ¶èŒƒå›´


### 4.1 LimitRangeæ¦‚å¿µç†è§£


**ğŸ”¸ LimitRange vs ResourceQuotaçš„åŒºåˆ«**ï¼š

```
ResourceQuotaï¼ˆèµ„æºé…é¢ï¼‰ï¼š          LimitRangeï¼ˆé™åˆ¶èŒƒå›´ï¼‰ï¼š
ç®¡ç†æ•´ä¸ªnamespaceçš„æ€»èµ„æº             ç®¡ç†å•ä¸ªPod/Containerçš„èµ„æºèŒƒå›´

å°±åƒæ˜¯ï¼š                           å°±åƒæ˜¯ï¼š
éƒ¨é—¨æ€»é¢„ç®—ä¸èƒ½è¶…è¿‡100ä¸‡              æ¯ä¸ªå‘˜å·¥å·¥èµ„åœ¨5K-20Kä¹‹é—´
```

### 4.2 æŸ¥çœ‹é™åˆ¶èŒƒå›´


```bash
# æŸ¥çœ‹å½“å‰namespaceçš„LimitRange
kubectl get limitrange

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
kubectl describe limitrange [name]
```

### 4.3 LimitRangeå·¥ä½œç¤ºä¾‹


**åˆ›å»ºLimitRangeé…ç½®**ï¼š
```yaml
apiVersion: v1
kind: LimitRange
metadata:
  name: pod-limit-range
spec:
  limits:
  - default:        # é»˜è®¤é™åˆ¶ï¼ˆå¦‚æœPodæ²¡æœ‰æŒ‡å®šï¼‰
      cpu: "500m"
      memory: "512Mi"
    defaultRequest: # é»˜è®¤è¯·æ±‚ï¼ˆå¦‚æœPodæ²¡æœ‰æŒ‡å®šï¼‰
      cpu: "100m" 
      memory: "128Mi"
    max:           # æœ€å¤§é™åˆ¶
      cpu: "1"
      memory: "1Gi"
    min:           # æœ€å°é™åˆ¶  
      cpu: "50m"
      memory: "64Mi"
    type: Container
```

---

## 5. ğŸ“ˆ èµ„æºç›‘æ§ä¸ç®¡ç†


### 5.1 æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨


**ğŸ–¥ï¸ èŠ‚ç‚¹çº§åˆ«èµ„æºç›‘æ§**

```bash
# æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„èµ„æºä½¿ç”¨æƒ…å†µ
kubectl top nodes

# æŸ¥çœ‹æŒ‡å®šèŠ‚ç‚¹çš„è¯¦ç»†èµ„æºåˆ†é…
kubectl describe node [node-name] | grep -A 5 "Allocated resources"
```

**è¾“å‡ºè§£è¯»ç¤ºä¾‹**ï¼š
```
NAME       CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
worker-1   259m         12%    1623Mi          42%
worker-2   180m         9%     1200Mi          31%
```

### 5.2 æŸ¥çœ‹Podèµ„æºä½¿ç”¨


```bash
# æŸ¥çœ‹å½“å‰namespaceä¸‹Podçš„èµ„æºä½¿ç”¨
kubectl top pods

# æŸ¥çœ‹æŒ‡å®šnamespaceä¸‹çš„Podèµ„æºä½¿ç”¨  
kubectl top pods -n [namespace]

# æŸ¥çœ‹æ‰€æœ‰namespaceçš„Podèµ„æºä½¿ç”¨
kubectl top pods --all-namespaces
```

### 5.3 èµ„æºé…é¢ä½¿ç”¨ç›‘æ§


**ğŸ“Š é…é¢ä½¿ç”¨æƒ…å†µè¿½è¸ª**

```bash
# ä»¥YAMLæ ¼å¼æŸ¥çœ‹é…é¢è¯¦æƒ…ï¼ˆåŒ…å«æ›´å¤šä¿¡æ¯ï¼‰
kubectl get resourcequota -o yaml

# å®æ—¶ç›‘æ§é…é¢ä½¿ç”¨å˜åŒ–
watch kubectl describe resourcequota [quota-name]
```

**ğŸ” é…é¢çŠ¶æ€å­—æ®µè§£æ**ï¼š
```yaml
status:
  hard:
    cpu: "2"
    memory: "4Gi" 
    pods: "10"
  used:
    cpu: "800m"      # å·²ä½¿ç”¨CPU
    memory: "1.5Gi"  # å·²ä½¿ç”¨å†…å­˜
    pods: "3"        # å·²åˆ›å»ºPodæ•°
```

---

## 6. ğŸ¢ å®æˆ˜åœºæ™¯åº”ç”¨


### 6.1 å¤šç¯å¢ƒèµ„æºéš”ç¦»


**åœºæ™¯æè¿°**ï¼šä¸ºå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒè®¾ç½®ä¸åŒçš„èµ„æºé…é¢

```bash
# å¼€å‘ç¯å¢ƒé…é¢ï¼ˆèµ„æºè¾ƒå°‘ï¼‰
kubectl create namespace dev
kubectl create quota dev-quota -n dev \
  --hard=requests.cpu=1,requests.memory=2Gi,pods=5

# æµ‹è¯•ç¯å¢ƒé…é¢ï¼ˆä¸­ç­‰èµ„æºï¼‰
kubectl create namespace test  
kubectl create quota test-quota -n test \
  --hard=requests.cpu=2,requests.memory=4Gi,pods=10

# ç”Ÿäº§ç¯å¢ƒé…é¢ï¼ˆå……è¶³èµ„æºï¼‰
kubectl create namespace prod
kubectl create quota prod-quota -n prod \
  --hard=requests.cpu=8,requests.memory=16Gi,pods=50
```

### 6.2 å›¢é˜Ÿèµ„æºåˆ†é…


**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```
å…¬å¸ç»„ç»‡ç»“æ„                    K8sèµ„æºåˆ†é…
     CTO                        é›†ç¾¤æ€»èµ„æº
   /  |  \                     /    |    \
ç ”å‘éƒ¨ æµ‹è¯•éƒ¨ è¿ç»´éƒ¨           dev-ns test-ns ops-ns
10äºº  5äºº   3äºº              4æ ¸8G   2æ ¸4G   1æ ¸2G
```

**åˆ›å»ºå›¢é˜Ÿé…é¢**ï¼š
```bash
# ç ”å‘å›¢é˜Ÿ
kubectl create quota team-dev \
  --hard=requests.cpu=4,requests.memory=8Gi,pods=20

# æµ‹è¯•å›¢é˜Ÿ
kubectl create quota team-test \
  --hard=requests.cpu=2,requests.memory=4Gi,pods=10

# è¿ç»´å›¢é˜Ÿ
kubectl create quota team-ops \
  --hard=requests.cpu=1,requests.memory=2Gi,pods=5
```

### 6.3 æˆæœ¬æ§åˆ¶å®è·µ


**ğŸ’° äº‘æœåŠ¡æˆæœ¬æ§åˆ¶ç­–ç•¥**

```
èµ„æºé…é¢è®¾ç½®åŸåˆ™ï¼š
â”œâ”€â”€ ğŸ¯ æŒ‰é¡¹ç›®é‡è¦æ€§åˆ†é…
â”œâ”€â”€ ğŸ“Š æ ¹æ®å†å²ä½¿ç”¨æ•°æ®è®¾å®š
â”œâ”€â”€ ğŸš¨ è®¾ç½®å‘Šè­¦é˜ˆå€¼ï¼ˆ80%ä½¿ç”¨ç‡ï¼‰
â””â”€â”€ ğŸ”„ å®šæœŸreviewå’Œè°ƒæ•´
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„å‘½ä»¤


**ğŸ”¥ æœ€æ ¸å¿ƒçš„5ä¸ªå‘½ä»¤**ï¼š
1. `kubectl create quota [name] --hard=cpu=1,memory=1G,pods=2` - åˆ›å»ºé…é¢
2. `kubectl get resourcequota` - æŸ¥çœ‹é…é¢åˆ—è¡¨
3. `kubectl describe resourcequota [name]` - æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
4. `kubectl patch resourcequota [name] --type='merge' -p='{"spec":{"hard":{"pods":"5"}}}'` - ä¿®æ”¹é…é¢
5. `kubectl top nodes` - æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨

### 7.2 å…³é”®æ¦‚å¿µç†è§£


**ğŸ¯ å¿…é¡»ç†è§£çš„æ¦‚å¿µ**ï¼š

| æ¦‚å¿µ | é€šä¿—è§£é‡Š | ä½œç”¨ |
|------|---------|------|
| **ResourceQuota** | å‘½åç©ºé—´çš„"èµ„æºé¢„ç®—" | é™åˆ¶æ€»ä½“èµ„æºä½¿ç”¨ |
| **LimitRange** | å•ä¸ªå®¹å™¨çš„"èµ„æºè§„èŒƒ" | é™åˆ¶å•ä½“èµ„æºèŒƒå›´ |
| **Request** | å®¹å™¨"æœ€å°‘éœ€è¦"çš„èµ„æº | è°ƒåº¦å†³ç­–ä¾æ® |
| **Limit** | å®¹å™¨"æœ€å¤šä½¿ç”¨"çš„èµ„æº | è¿è¡Œæ—¶é™åˆ¶ |

### 7.3 å®è·µç»éªŒæ€»ç»“


**âœ… æœ€ä½³å®è·µå»ºè®®**ï¼š
- **åˆ†å±‚ç®¡ç†**ï¼šnamespace â†’ resourcequota â†’ limitrange â†’ pod
- **åˆç†è®¾ç½®**ï¼šrequest < limitï¼Œé¿å…èµ„æºæµªè´¹
- **ç›‘æ§å‘Šè­¦**ï¼šä½¿ç”¨ç‡è¶…è¿‡80%æ—¶åŠæ—¶è°ƒæ•´
- **å®šæœŸreview**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ–é…é¢

**âŒ å¸¸è§é”™è¯¯é¿å…**ï¼š
- ä¸è¦è®¾ç½®è¿‡å°çš„é…é¢å¯¼è‡´åº”ç”¨æ— æ³•å¯åŠ¨
- ä¸è¦å¿½ç•¥LimitRangeå¯¼è‡´å•ä¸ªPodå ç”¨è¿‡å¤šèµ„æº
- ä¸è¦è®¾ç½®é…é¢åä¸ç›‘æ§ä½¿ç”¨æƒ…å†µ

**ğŸ”§ æ•…éšœæ’æŸ¥æ€è·¯**ï¼š
```
Podåˆ›å»ºå¤±è´¥ â†’ æ£€æŸ¥ResourceQuota â†’ æ£€æŸ¥LimitRange â†’ æ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µ
                      â†“                    â†“                â†“
              é…é¢æ˜¯å¦å……è¶³ï¼Ÿ          é™åˆ¶æ˜¯å¦åˆç†ï¼Ÿ      èŠ‚ç‚¹èµ„æºæ˜¯å¦è¶³å¤Ÿï¼Ÿ
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ResourceQuotaç®¡ç†namespaceæ€»èµ„æºï¼Œåƒéƒ¨é—¨é¢„ç®—
- LimitRangeç®¡ç†å•ä¸ªå®¹å™¨èµ„æºï¼Œåƒä¸ªäººé™é¢  
- Requestæ˜¯è°ƒåº¦ä¾æ®ï¼ŒLimitæ˜¯è¿è¡Œé™åˆ¶
- èµ„æºé…é¢æ˜¯å¤šç§Ÿæˆ·ç¯å¢ƒçš„åŸºç¡€ä¿éšœæœºåˆ¶