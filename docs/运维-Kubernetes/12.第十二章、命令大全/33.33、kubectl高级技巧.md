---
title: 33ã€kubectlé«˜çº§æŠ€å·§
---
## ğŸ“š ç›®å½•

1. [kubectlé«˜çº§æŠ€å·§ä¸å®ç”¨å‘½ä»¤](#1-kubectlé«˜çº§æŠ€å·§ä¸å®ç”¨å‘½ä»¤)
2. [èµ„æºæ¯”è¾ƒä¸å·®å¼‚æ£€æµ‹](#2-èµ„æºæ¯”è¾ƒä¸å·®å¼‚æ£€æµ‹)
3. [ç­‰å¾…æœºåˆ¶ä¸åŒæ­¥æ“ä½œ](#3-ç­‰å¾…æœºåˆ¶ä¸åŒæ­¥æ“ä½œ)
4. [ä»»åŠ¡ç®¡ç†ä¸è°ƒè¯•åŠŸèƒ½](#4-ä»»åŠ¡ç®¡ç†ä¸è°ƒè¯•åŠŸèƒ½)
5. [è¯ä¹¦ç®¡ç†ä¸å®‰å…¨æ“ä½œ](#5-è¯ä¹¦ç®¡ç†ä¸å®‰å…¨æ“ä½œ)
6. [åŸå§‹APIè®¿é—®ä¸ç›‘æ§](#6-åŸå§‹APIè®¿é—®ä¸ç›‘æ§)
7. [æœåŠ¡è´¦æˆ·ä¸Tokenç®¡ç†](#7-æœåŠ¡è´¦æˆ·ä¸Tokenç®¡ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ kubectlé«˜çº§æŠ€å·§ä¸å®ç”¨å‘½ä»¤


### 1.1 ä»€ä¹ˆæ˜¯kubectlé«˜çº§æŠ€å·§


**ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ**
kubectlä¸ä»…ä»…æ˜¯ç®€å•çš„å¢åˆ æ”¹æŸ¥å·¥å…·ï¼Œå®ƒè¿˜æä¾›äº†è®¸å¤šé«˜çº§åŠŸèƒ½æ¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç®¡ç†Kubernetesé›†ç¾¤ã€‚è¿™äº›é«˜çº§æŠ€å·§å°±åƒæ˜¯"ç‘å£«å†›åˆ€"ï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½éƒ½æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ã€‚

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦é«˜çº§æŠ€å·§**
- **æé«˜æ•ˆç‡**ï¼šä¸€ä¸ªå‘½ä»¤å®Œæˆå¤æ‚æ“ä½œï¼Œé¿å…é‡å¤åŠ³åŠ¨
- **ç²¾ç¡®æ§åˆ¶**ï¼šæ›´ç²¾ç»†åœ°æ§åˆ¶èµ„æºçŠ¶æ€å’Œæ“ä½œæ—¶æœº
- **æ•…éšœè¯Šæ–­**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³ç”Ÿäº§ç¯å¢ƒé—®é¢˜
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šä¸ºè„šæœ¬å’ŒCI/CDæä¾›å¼ºå¤§æ”¯æ’‘

### 1.2 é«˜çº§å‘½ä»¤åˆ†ç±»ä¸åº”ç”¨åœºæ™¯


**ğŸ”¸ èµ„æºçŠ¶æ€ç®¡ç†ç±»**
```
é€‚ç”¨åœºæ™¯ï¼š
â€¢ éƒ¨ç½²å‰çš„å·®å¼‚é¢„æ£€
â€¢ èµ„æºçŠ¶æ€åŒæ­¥ç­‰å¾…
â€¢ ç²¾ç¡®çš„èµ„æºç”Ÿå‘½å‘¨æœŸæ§åˆ¶

å…¸å‹åº”ç”¨ï¼š
â€¢ ç°åº¦å‘å¸ƒå‰ç¡®è®¤å˜æ›´å†…å®¹
â€¢ ç­‰å¾…Podå®Œå…¨åˆ é™¤åè¿›è¡Œåç»­æ“ä½œ
â€¢ ç¡®ä¿èµ„æºæŒ‰é¢„æœŸé¡ºåºå¯åŠ¨
```

**ğŸ”¸ è°ƒè¯•ä¸ç›‘æ§ç±»**
```
é€‚ç”¨åœºæ™¯ï¼š
â€¢ ç”Ÿäº§ç¯å¢ƒæ•…éšœæ’æŸ¥
â€¢ æ€§èƒ½ç›‘æ§æ•°æ®è·å–
â€¢ æ·±åº¦æŠ€æœ¯è°ƒè¯•

å…¸å‹åº”ç”¨ï¼š
â€¢ ä¸´æ—¶å¯åŠ¨è°ƒè¯•å®¹å™¨æ’æŸ¥é—®é¢˜
â€¢ è·å–èŠ‚ç‚¹è¯¦ç»†æ€§èƒ½æŒ‡æ ‡
â€¢ ç›‘æ§é›†ç¾¤å¥åº·çŠ¶å†µ
```

**ğŸ”¸ å®‰å…¨ä¸æƒé™ç±»**
```
é€‚ç”¨åœºæ™¯ï¼š
â€¢ è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†
â€¢ æœåŠ¡è´¦æˆ·æƒé™æ§åˆ¶
â€¢ å®‰å…¨å®¡è®¡ä¸åˆè§„

å…¸å‹åº”ç”¨ï¼š
â€¢ æ‰¹é‡å¤„ç†è¯ä¹¦ç”³è¯·
â€¢ ä¸ºåº”ç”¨åˆ›å»ºä¸´æ—¶è®¿é—®å‡­æ®
â€¢ å®¡è®¡å’Œç›‘æ§æƒé™ä½¿ç”¨
```

---

## 2. ğŸ” èµ„æºæ¯”è¾ƒä¸å·®å¼‚æ£€æµ‹


### 2.1 kubectl diffå‘½ä»¤è¯¦è§£


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`kubectl diff`å°±åƒæ˜¯Gitçš„`git diff`å‘½ä»¤ï¼Œå®ƒèƒ½å‘Šè¯‰ä½ å°†è¦åº”ç”¨çš„é…ç½®æ–‡ä»¶ä¸é›†ç¾¤ä¸­ç°æœ‰èµ„æºæœ‰ä»€ä¹ˆä¸åŒã€‚è¿™æ˜¯ä¸€ä¸ª**é¢„è§ˆåŠŸèƒ½**ï¼Œä¸ä¼šå®é™…ä¿®æ”¹ä»»ä½•èµ„æºã€‚

**ğŸ’­ ä¸ºä»€ä¹ˆéœ€è¦å·®å¼‚æ£€æµ‹**
æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªå¤æ‚çš„éƒ¨ç½²é…ç½®ï¼ŒåŒ…å«å‡ åä¸ªå‚æ•°ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›´æ¥`kubectl apply`ä¼šå¾ˆå±é™©ï¼Œå› ä¸ºä½ ä¸çŸ¥é“åˆ°åº•ä¼šæ”¹å˜ä»€ä¹ˆã€‚`kubectl diff`å°±åƒæ˜¯"è¯•è¡£é•œ"ï¼Œè®©ä½ æå‰çœ‹åˆ°æ•ˆæœã€‚

### 2.2 å®ç”¨æ“ä½œç¤ºä¾‹


**ğŸ”§ åŸºæœ¬ç”¨æ³•**
```bash
# æ¯”è¾ƒå•ä¸ªæ–‡ä»¶ä¸é›†ç¾¤çŠ¶æ€
kubectl diff -f deployment.yaml

# æ¯”è¾ƒæ•´ä¸ªç›®å½•çš„é…ç½®
kubectl diff -f ./manifests/

# æ¯”è¾ƒç‰¹å®šå‘½åç©ºé—´çš„èµ„æº
kubectl diff -f app.yaml -n production
```

**ğŸ“Š å·®å¼‚è¾“å‡ºè§£è¯»**
```
è¾“å‡ºæ ¼å¼è§£è¯»ï¼š
- çº¢è‰²è¡Œï¼šå°†è¢«åˆ é™¤çš„å†…å®¹
+ ç»¿è‰²è¡Œï¼šå°†è¢«æ·»åŠ çš„å†…å®¹
~ é»„è‰²è¡Œï¼šå°†è¢«ä¿®æ”¹çš„å†…å®¹

å®é™…è¾“å‡ºç¤ºä¾‹ï¼š
-   replicas: 2           â† å½“å‰é›†ç¾¤ä¸­æ˜¯2ä¸ªå‰¯æœ¬
+   replicas: 3           â† é…ç½®æ–‡ä»¶è¦æ±‚3ä¸ªå‰¯æœ¬
-   image: nginx:1.20     â† å½“å‰ä½¿ç”¨1.20ç‰ˆæœ¬
+   image: nginx:1.21     â† è¦å‡çº§åˆ°1.21ç‰ˆæœ¬
```

### 2.3 é«˜çº§å·®å¼‚æ£€æµ‹æŠ€å·§


**ğŸ”¸ ç»“åˆå…¶ä»–å‘½ä»¤ä½¿ç”¨**
```bash
# å·®å¼‚æ£€æµ‹é€šè¿‡åå†åº”ç”¨
kubectl diff -f deployment.yaml && kubectl apply -f deployment.yaml

# å°†å·®å¼‚ç»“æœä¿å­˜åˆ°æ–‡ä»¶
kubectl diff -f deployment.yaml > changes.diff

# åªæ˜¾ç¤ºç‰¹å®šç±»å‹çš„å·®å¼‚
kubectl diff -f deployment.yaml | grep -E "^\+|\-"
```

**âš¡ å®é™…åº”ç”¨åœºæ™¯**
```
åœºæ™¯1ï¼šç”Ÿäº§ç¯å¢ƒå˜æ›´å®¡æ‰¹
â€¢ è¿ç»´äººå‘˜å…ˆæ‰§è¡Œdiffå‘½ä»¤
â€¢ å°†å·®å¼‚æŠ¥å‘Šæäº¤ç»™æŠ€æœ¯è´Ÿè´£äººå®¡æ ¸
â€¢ å®¡æ ¸é€šè¿‡åæ‰æ‰§è¡Œå®é™…éƒ¨ç½²

åœºæ™¯2ï¼šæ‰¹é‡é…ç½®æ›´æ–°
â€¢ æ›´æ–°å¤šä¸ªåº”ç”¨çš„é…ç½®æ–‡ä»¶
â€¢ ä½¿ç”¨diffç¡®è®¤æ¯ä¸ªåº”ç”¨çš„å˜æ›´å†…å®¹
â€¢ ç¡®ä¿æ²¡æœ‰æ„å¤–çš„é…ç½®ä¿®æ”¹

åœºæ™¯3ï¼šç‰ˆæœ¬å›æ»šé¢„æ£€
â€¢ å‡†å¤‡å›æ»šé…ç½®æ–‡ä»¶
â€¢ ç”¨diffæŸ¥çœ‹å›æ»šä¼šæ”¹å˜å“ªäº›å†…å®¹
â€¢ ç¡®è®¤å›æ»šèŒƒå›´ç¬¦åˆé¢„æœŸ
```

---

## 3. â±ï¸ ç­‰å¾…æœºåˆ¶ä¸åŒæ­¥æ“ä½œ


### 3.1 kubectl waitå‘½ä»¤çš„ä½œç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç­‰å¾…æœºåˆ¶**
åœ¨Kubernetesä¸­ï¼Œå¾ˆå¤šæ“ä½œæ˜¯**å¼‚æ­¥çš„**ã€‚æ¯”å¦‚ä½ åˆ é™¤ä¸€ä¸ªPodï¼Œå‘½ä»¤ç«‹å³è¿”å›ï¼Œä½†Podå¯èƒ½è¿˜éœ€è¦å‡ ç§’é’Ÿæ‰çœŸæ­£æ¶ˆå¤±ã€‚`kubectl wait`å‘½ä»¤è®©ä½ èƒ½å¤Ÿ"ç­‰å¾…"æŸä¸ªæ¡ä»¶æˆç«‹åå†ç»§ç»­ã€‚

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…æœºåˆ¶**
```
é—®é¢˜åœºæ™¯ï¼š
è„šæœ¬æ‰§è¡Œé¡ºåºï¼š
1. åˆ é™¤æ—§çš„Pod
2. åˆ›å»ºæ–°çš„Pod

å¦‚æœæ²¡æœ‰ç­‰å¾…æœºåˆ¶ï¼š
â€¢ åˆ é™¤å‘½ä»¤ç«‹å³è¿”å›
â€¢ ç«‹å³åˆ›å»ºæ–°Pod
â€¢ å¯èƒ½å› ä¸ºèµ„æºå†²çªå¯¼è‡´å¤±è´¥

ä½¿ç”¨ç­‰å¾…æœºåˆ¶ï¼š
â€¢ åˆ é™¤æ—§Pod
â€¢ ç­‰å¾…Podå®Œå…¨æ¶ˆå¤±
â€¢ å†åˆ›å»ºæ–°Podï¼Œç¡®ä¿æˆåŠŸ
```

### 3.2 waitå‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•


**ğŸ”§ åŸºæœ¬è¯­æ³•æ ¼å¼**
```bash
kubectl wait --for=condition [resource] [options]

å¸¸ç”¨æ¡ä»¶ç±»å‹ï¼š
â€¢ --for=delete          ç­‰å¾…èµ„æºè¢«åˆ é™¤
â€¢ --for=condition=Ready ç­‰å¾…èµ„æºå°±ç»ª
â€¢ --for=jsonpath='{.status.phase}=Running' ç­‰å¾…ç‰¹å®šçŠ¶æ€
```

**ğŸ“‹ å®ç”¨ç¤ºä¾‹**
```bash
# ç­‰å¾…Podè¢«å®Œå…¨åˆ é™¤
kubectl wait --for=delete pod/my-pod

# ç­‰å¾…Podå˜ä¸ºReadyçŠ¶æ€
kubectl wait --for=condition=Ready pod/my-pod

# è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤30ç§’ï¼‰
kubectl wait --for=delete pod/my-pod --timeout=60s

# ç­‰å¾…å¤šä¸ªèµ„æº
kubectl wait --for=condition=Ready pod -l app=frontend
```

### 3.3 é«˜çº§ç­‰å¾…ç­–ç•¥


**ğŸ¯ å¤æ‚æ¡ä»¶ç­‰å¾…**
```bash
# ç­‰å¾…Deploymentå®Œæˆæ»šåŠ¨æ›´æ–°
kubectl wait --for=condition=Progressing=True deployment/my-app

# ç­‰å¾…Jobæ‰§è¡Œå®Œæˆ
kubectl wait --for=condition=Complete job/batch-job

# ç­‰å¾…Nodeå˜ä¸ºReadyçŠ¶æ€
kubectl wait --for=condition=Ready node/worker-node-01
```

**ğŸ”„ è„šæœ¬ä¸­çš„æœ€ä½³å®è·µ**
```bash
#!/bin/bash
# å®‰å…¨çš„æœåŠ¡æ›´æ–°è„šæœ¬

echo "å¼€å§‹æ›´æ–°æœåŠ¡..."

# 1. å…ˆå¤‡ä»½å½“å‰é…ç½®
kubectl get deployment my-app -o yaml > backup.yaml

# 2. åº”ç”¨æ–°é…ç½®
kubectl apply -f new-deployment.yaml

# 3. ç­‰å¾…éƒ¨ç½²å®Œæˆ
echo "ç­‰å¾…éƒ¨ç½²å®Œæˆ..."
kubectl wait --for=condition=Available deployment/my-app --timeout=300s

if [ $? -eq 0 ]; then
    echo "éƒ¨ç½²æˆåŠŸï¼"
else
    echo "éƒ¨ç½²å¤±è´¥ï¼Œå¼€å§‹å›æ»š..."
    kubectl apply -f backup.yaml
    exit 1
fi
```

---

## 4. ğŸ› ï¸ ä»»åŠ¡ç®¡ç†ä¸è°ƒè¯•åŠŸèƒ½


### 4.1 ä»CronJobåˆ›å»ºä¸´æ—¶Job


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦**ç«‹å³æ‰§è¡Œ**ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ä¸‹æ¬¡å®šæ—¶è§¦å‘ã€‚`kubectl create job --from=cronjob`å°±æ˜¯ä¸“é—¨è§£å†³è¿™ä¸ªéœ€æ±‚çš„ã€‚

**ğŸ’­ å®é™…åº”ç”¨åœºæ™¯**
```
åœºæ™¯è¯´æ˜ï¼š
â€¢ ä½ æœ‰ä¸€ä¸ªæ¯å¤©æ™šä¸Šæ‰§è¡Œçš„æ•°æ®å¤‡ä»½CronJob
â€¢ ç™½å¤©éœ€è¦ç´§æ€¥å¤‡ä»½æ•°æ®
â€¢ ä¸æƒ³ç­‰åˆ°æ™šä¸Šï¼Œä¹Ÿä¸æƒ³æ‰‹åŠ¨åˆ›å»ºå¤æ‚çš„Jobé…ç½®

è§£å†³æ–¹æ¡ˆï¼š
â€¢ ç›´æ¥ä»CronJobåˆ›å»ºä¸€ä¸ªä¸´æ—¶Job
â€¢ Jobä¼šä½¿ç”¨CronJobç›¸åŒçš„é…ç½®å’Œé•œåƒ
â€¢ ç«‹å³æ‰§è¡Œï¼Œä¸å½±å“åŸæœ‰å®šæ—¶è®¡åˆ’
```

### 4.2 Jobç®¡ç†å®è·µ


**ğŸ”§ åŸºæœ¬æ“ä½œ**
```bash
# ä»CronJobåˆ›å»ºä¸´æ—¶Job
kubectl create job manual-backup --from=cronjob/daily-backup

# æŸ¥çœ‹Jobæ‰§è¡ŒçŠ¶æ€
kubectl get job manual-backup

# æŸ¥çœ‹Jobçš„Podæ—¥å¿—
kubectl logs job/manual-backup

# åˆ é™¤ä¸´æ—¶Job
kubectl delete job manual-backup
```

**ğŸ“Š JobçŠ¶æ€ç›‘æ§**
```bash
# ç­‰å¾…Jobå®Œæˆ
kubectl wait --for=condition=Complete job/manual-backup --timeout=600s

# æ£€æŸ¥Jobæ˜¯å¦å¤±è´¥
kubectl get job manual-backup -o jsonpath='{.status.failed}'

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
kubectl describe job manual-backup
```

### 4.3 è°ƒè¯•å®¹å™¨åŠŸèƒ½ï¼ˆAlphaç‰¹æ€§ï¼‰


**ğŸ”¸ ä»€ä¹ˆæ˜¯è°ƒè¯•å®¹å™¨**
è°ƒè¯•å®¹å™¨æ˜¯Kubernetesçš„ä¸€ä¸ª**å®éªŒæ€§åŠŸèƒ½**ï¼Œå…è®¸ä½ åœ¨ä¸€ä¸ªè¿è¡Œä¸­çš„Podé‡Œå¯åŠ¨ä¸€ä¸ªä¸´æ—¶çš„è°ƒè¯•å®¹å™¨ã€‚è¿™å°±åƒæ˜¯ç»™æ­£åœ¨è¿è¡Œçš„ç¨‹åº"æ’å…¥"ä¸€ä¸ªè°ƒè¯•å·¥å…·ã€‚

**âš ï¸ æ³¨æ„äº‹é¡¹**
```
ä½¿ç”¨é™åˆ¶ï¼š
â€¢ è¿™æ˜¯AlphaåŠŸèƒ½ï¼Œå¯èƒ½ä¸ç¨³å®š
â€¢ éœ€è¦Kubernetes 1.18+ç‰ˆæœ¬
â€¢ éœ€è¦å¯ç”¨EphemeralContainersç‰¹æ€§é—¨
â€¢ ä¸»è¦ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ

å®‰å…¨è€ƒè™‘ï¼š
â€¢ è°ƒè¯•å®¹å™¨å¯ä»¥è®¿é—®Podçš„ç½‘ç»œå’Œå­˜å‚¨
â€¢ ä¸åº”è¯¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éšæ„ä½¿ç”¨
â€¢ éœ€è¦é€‚å½“çš„æƒé™æ§åˆ¶
```

**ğŸ”§ è°ƒè¯•æ“ä½œç¤ºä¾‹**
```bash
# åœ¨è¿è¡Œçš„Podä¸­å¯åŠ¨è°ƒè¯•å®¹å™¨
kubectl alpha debug my-pod -it --image=busybox

# ä½¿ç”¨ç‰¹å®šçš„è°ƒè¯•å·¥å…·é•œåƒ
kubectl alpha debug my-pod -it --image=nicolaka/netshoot

# è°ƒè¯•å®¹å™¨çš„å…¸å‹ç”¨æ³•
åœ¨è°ƒè¯•å®¹å™¨ä¸­å¯ä»¥ï¼š
â€¢ æŸ¥çœ‹ç½‘ç»œè¿æ¥ï¼šnetstat -tulnp
â€¢ æµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼šping, telnet, curl
â€¢ æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿï¼šls, cat, tail
â€¢ åˆ†æè¿›ç¨‹çŠ¶æ€ï¼šps aux, top
```

---

## 5. ğŸ” è¯ä¹¦ç®¡ç†ä¸å®‰å…¨æ“ä½œ


### 5.1 è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰ç®¡ç†


**ğŸ”¸ ä»€ä¹ˆæ˜¯CSR**
CSRï¼ˆCertificate Signing Requestï¼‰æ˜¯**è¯ä¹¦ç­¾åè¯·æ±‚**ã€‚åœ¨Kubernetesä¸­ï¼Œå½“èŠ‚ç‚¹æˆ–æœåŠ¡éœ€è¦è¯ä¹¦æ—¶ï¼Œä¼šå‘é›†ç¾¤æäº¤CSRï¼Œç„¶åç”±ç®¡ç†å‘˜æˆ–è‡ªåŠ¨åŒ–ç³»ç»Ÿæ‰¹å‡†æˆ–æ‹’ç»ã€‚

**ğŸ’¡ è¯ä¹¦ç®¡ç†çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦è¯ä¹¦ç®¡ç†ï¼š
â€¢ èŠ‚ç‚¹åŠ å…¥é›†ç¾¤éœ€è¦è¯ä¹¦éªŒè¯èº«ä»½
â€¢ æœåŠ¡é—´é€šä¿¡éœ€è¦TLSåŠ å¯†
â€¢ ç”¨æˆ·è®¿é—®é›†ç¾¤éœ€è¦å®¢æˆ·ç«¯è¯ä¹¦
â€¢ è¯ä¹¦è¿‡æœŸéœ€è¦æ›´æ–°å’Œè½®æ¢

è¯ä¹¦çš„ç”Ÿå‘½å‘¨æœŸï¼š
1. åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰
2. ç®¡ç†å‘˜å®¡æ ¸è¯·æ±‚å†…å®¹
3. æ‰¹å‡†æˆ–æ‹’ç»è¯·æ±‚
4. ç³»ç»Ÿé¢å‘è¯ä¹¦
5. è¯ä¹¦åˆ°æœŸå‰æ›´æ–°
```

### 5.2 CSRæ“ä½œå®è·µ


**ğŸ”§ æŸ¥çœ‹å’Œç®¡ç†CSR**
```bash
# æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦ç­¾åè¯·æ±‚
kubectl get csr

# æŸ¥çœ‹CSRè¯¦ç»†ä¿¡æ¯
kubectl describe csr node-csr-example

# æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚
kubectl certificate approve node-csr-example

# æ‹’ç»è¯ä¹¦ç­¾åè¯·æ±‚
kubectl certificate deny malicious-csr

# åˆ é™¤å·²å¤„ç†çš„CSR
kubectl delete csr processed-csr
```

**ğŸ“‹ CSRçŠ¶æ€è§£è¯»**
```
CSRçŠ¶æ€è¯´æ˜ï¼š
â€¢ Pendingï¼šç­‰å¾…æ‰¹å‡†
â€¢ Approvedï¼šå·²æ‰¹å‡†ï¼Œç­‰å¾…è¯ä¹¦é¢å‘
â€¢ Deniedï¼šå·²æ‹’ç»
â€¢ Issuedï¼šè¯ä¹¦å·²é¢å‘

å…¸å‹è¾“å‡ºç¤ºä¾‹ï¼š
NAME                 AGE   SIGNERNAME            REQUESTOR     CONDITION
node-csr-abc123      5m    kubernetes.io/kubelet system:node   Pending
user-csr-def456      2m    kubernetes.io/kube... admin         Approved
```

### 5.3 è¯ä¹¦ç®¡ç†æœ€ä½³å®è·µ


**ğŸ”¸ å®‰å…¨å®¡æ ¸æµç¨‹**
```bash
# 1. å®šæœŸæ£€æŸ¥å¾…å¤„ç†çš„CSR
kubectl get csr --field-selector=status.phase=Pending

# 2. è¯¦ç»†å®¡æ ¸CSRå†…å®¹
kubectl get csr suspicious-csr -o yaml

# 3. éªŒè¯è¯·æ±‚æ¥æºå’Œæƒé™
kubectl describe csr suspicious-csr | grep "Requested by"

# 4. æ‰¹é‡å¤„ç†åˆæ³•çš„CSR
kubectl get csr -o name | xargs kubectl certificate approve
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
è¯ä¹¦å®¡æ‰¹åŸåˆ™ï¼š
â€¢ éªŒè¯CSRçš„æ¥æºå’Œè¯·æ±‚è€…èº«ä»½
â€¢ æ£€æŸ¥è¯ä¹¦çš„ä½¿ç”¨ç›®çš„å’Œæƒé™èŒƒå›´
â€¢ ä¸è¦æ‰¹å‡†æ¥æºä¸æ˜çš„CSR
â€¢ å®šæœŸæ¸…ç†å·²è¿‡æœŸçš„CSRè®°å½•

è‡ªåŠ¨åŒ–å»ºè®®ï¼š
â€¢ ä¸ºå·²çŸ¥çš„ç³»ç»Ÿç»„ä»¶è®¾ç½®è‡ªåŠ¨æ‰¹å‡†è§„åˆ™
â€¢ å¯¹ç”¨æˆ·è¯ä¹¦è¯·æ±‚ä¿æŒäººå·¥å®¡æ ¸
â€¢ è®¾ç½®è¯ä¹¦æœ‰æ•ˆæœŸå’Œè‡ªåŠ¨è½®æ¢
â€¢ å»ºç«‹è¯ä¹¦ä½¿ç”¨æƒ…å†µç›‘æ§
```

---

## 6. ğŸ“Š åŸå§‹APIè®¿é—®ä¸ç›‘æ§


### 6.1 ä»€ä¹ˆæ˜¯åŸå§‹APIè®¿é—®


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`kubectl get --raw`å…è®¸ä½ ç›´æ¥è®¿é—®Kubernetesçš„**åŸå§‹REST API**ï¼Œç»•è¿‡kubectlçš„å¸¸è§„æ ¼å¼åŒ–è¾“å‡ºã€‚è¿™å°±åƒæ˜¯ç›´æ¥ä¸Kubernetesçš„"å¤§è„‘"å¯¹è¯ï¼Œè·å–æœ€åŸå§‹ã€æœ€å®Œæ•´çš„æ•°æ®ã€‚

**ğŸ’­ ä¸ºä»€ä¹ˆéœ€è¦åŸå§‹API**
```
å¸¸è§„kubectlçš„å±€é™ï¼š
â€¢ è¾“å‡ºæ ¼å¼å›ºå®šï¼Œå¯èƒ½ç¼ºå°‘æŸäº›å­—æ®µ
â€¢ æ— æ³•è®¿é—®ä¸€äº›ç‰¹æ®Šçš„APIç«¯ç‚¹
â€¢ ç›‘æ§æ•°æ®éœ€è¦åŸå§‹æ ¼å¼

åŸå§‹APIçš„ä¼˜åŠ¿ï¼š
â€¢ è·å–å®Œæ•´çš„JSONæ•°æ®
â€¢ è®¿é—®ç›‘æ§å’Œç»Ÿè®¡ä¿¡æ¯
â€¢ æ”¯æŒè‡ªå®šä¹‰çš„APIç«¯ç‚¹
â€¢ ä¾¿äºè„šæœ¬å¤„ç†å’Œè‡ªåŠ¨åŒ–
```

### 6.2 åŸå§‹APIä½¿ç”¨å®ä¾‹


**ğŸ”§ åŸºæœ¬æ“ä½œ**
```bash
# è·å–èŠ‚ç‚¹çš„è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
kubectl get --raw /api/v1/nodes/worker-01/proxy/stats/summary

# è·å–é›†ç¾¤æŒ‡æ ‡ï¼ˆå¦‚æœå¯ç”¨ï¼‰
kubectl get --raw /metrics

# è·å–APIæœåŠ¡å™¨çš„å¥åº·çŠ¶æ€
kubectl get --raw /healthz

# è·å–ç‰ˆæœ¬ä¿¡æ¯
kubectl get --raw /version
```

**ğŸ“Š èŠ‚ç‚¹ç›‘æ§æ•°æ®è§£æ**
```bash
# è·å–èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
kubectl get --raw /api/v1/nodes/worker-01/proxy/stats/summary | jq '.node.memory'

# è¾“å‡ºç¤ºä¾‹ï¼š
{
  "availableBytes": 1073741824,
  "capacityBytes": 4294967296,
  "workingSetBytes": 2147483648,
  "usageBytes": 3221225472
}

# è®¡ç®—å†…å­˜ä½¿ç”¨ç‡
ä½¿ç”¨ç‡ = usageBytes / capacityBytes Ã— 100%
      = 3221225472 / 4294967296 Ã— 100% 
      = 75%
```

### 6.3 é«˜çº§ç›‘æ§æŠ€å·§


**ğŸ¯ è‡ªå®šä¹‰ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# èŠ‚ç‚¹èµ„æºç›‘æ§è„šæœ¬

NODES=$(kubectl get nodes -o name | cut -d'/' -f2)

for node in $NODES; do
    echo "=== èŠ‚ç‚¹: $node ==="
    
    # è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ
    MEMORY_DATA=$(kubectl get --raw /api/v1/nodes/$node/proxy/stats/summary | jq '.node.memory')
    MEMORY_USAGE=$(echo $MEMORY_DATA | jq '.usageBytes')
    MEMORY_CAPACITY=$(echo $MEMORY_DATA | jq '.capacityBytes')
    
    # è®¡ç®—ä½¿ç”¨ç‡
    USAGE_PERCENT=$(echo "scale=2; $MEMORY_USAGE * 100 / $MEMORY_CAPACITY" | bc)
    echo "å†…å­˜ä½¿ç”¨ç‡: ${USAGE_PERCENT}%"
    
    # è·å–CPUä½¿ç”¨æƒ…å†µ
    CPU_DATA=$(kubectl get --raw /api/v1/nodes/$node/proxy/stats/summary | jq '.node.cpu')
    echo "CPUä½¿ç”¨æƒ…å†µ: $(echo $CPU_DATA | jq '.usageCoreNanoSeconds')"
    
    echo ""
done
```

**ğŸ” APIæ¢ç´¢æŠ€å·§**
```bash
# åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„APIè·¯å¾„
kubectl get --raw /api/v1 | jq '.resources[].name' | sort

# æŸ¥çœ‹ç‰¹å®šèµ„æºçš„APIç»“æ„
kubectl get --raw /api/v1/pods | jq '.items[0]' | head -20

# è·å–é›†ç¾¤äº‹ä»¶
kubectl get --raw /api/v1/events | jq '.items[] | select(.reason=="Failed")'
```

---

## 7. ğŸ‘¤ æœåŠ¡è´¦æˆ·ä¸Tokenç®¡ç†


### 7.1 æœåŠ¡è´¦æˆ·Tokençš„ä½œç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯æœåŠ¡è´¦æˆ·**
æœåŠ¡è´¦æˆ·ï¼ˆServiceAccountï¼‰æ˜¯ä¸ºPodä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºæä¾›èº«ä»½æ ‡è¯†çš„æœºåˆ¶ã€‚å°±åƒç»™æ¯ä¸ªåº”ç”¨å‘æ”¾ä¸€å¼ "èº«ä»½è¯"ï¼Œè®©å®ƒä»¬èƒ½å¤Ÿå®‰å…¨åœ°è®¿é—®Kubernetes APIã€‚

**ğŸ’¡ Tokençš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦Tokenï¼š
â€¢ åº”ç”¨ç¨‹åºéœ€è¦è®¿é—®Kubernetes API
â€¢ ä¸åŒåº”ç”¨éœ€è¦ä¸åŒçš„æƒé™çº§åˆ«
â€¢ éœ€è¦å®‰å…¨çš„èº«ä»½éªŒè¯æœºåˆ¶
â€¢ æ”¯æŒæƒé™çš„ç²¾ç»†æ§åˆ¶

Tokençš„ä½¿ç”¨åœºæ™¯ï¼š
â€¢ CI/CDç³»ç»Ÿéƒ¨ç½²åº”ç”¨
â€¢ ç›‘æ§ç³»ç»Ÿæ”¶é›†é›†ç¾¤ä¿¡æ¯
â€¢ åº”ç”¨ç¨‹åºåŠ¨æ€æ‰©ç¼©å®¹
â€¢ è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬
```

### 7.2 Tokenåˆ›å»ºä¸ç®¡ç†


**ğŸ”§ åŸºæœ¬æ“ä½œ**
```bash
# ä¸ºé»˜è®¤æœåŠ¡è´¦æˆ·åˆ›å»ºToken
kubectl create token default

# ä¸ºç‰¹å®šæœåŠ¡è´¦æˆ·åˆ›å»ºToken
kubectl create token my-service-account

# åˆ›å»ºå…·æœ‰ç‰¹å®šæœ‰æ•ˆæœŸçš„Token
kubectl create token my-service-account --duration=1h

# åˆ›å»ºTokenå¹¶ä¿å­˜åˆ°æ–‡ä»¶
kubectl create token my-service-account > token.txt
```

**ğŸ“‹ Tokenä½¿ç”¨ç¤ºä¾‹**
```bash
# ä½¿ç”¨Tokenè®¿é—®API
TOKEN=$(kubectl create token my-service-account)
APISERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')

# æµ‹è¯•Tokenæƒé™
curl -X GET $APISERVER/api/v1/namespaces/default/pods \
  -H "Authorization: Bearer $TOKEN" \
  -k

# åœ¨Podä¸­ä½¿ç”¨Token
# Tokenä¼šè‡ªåŠ¨æŒ‚è½½åˆ° /var/run/secrets/kubernetes.io/serviceaccount/token
```

### 7.3 æœåŠ¡è´¦æˆ·æƒé™ç®¡ç†


**ğŸ”¸ RBACæƒé™é…ç½®**
```yaml
# åˆ›å»ºæœåŠ¡è´¦æˆ·
apiVersion: v1
kind: ServiceAccount
metadata:
  name: deployment-manager
  namespace: default

---
# åˆ›å»ºè§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: deployment-manager-role
rules:
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "create", "update", "patch"]

---
# ç»‘å®šè§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: deployment-manager-binding
  namespace: default
subjects:
- kind: ServiceAccount
  name: deployment-manager
  namespace: default
roleRef:
  kind: Role
  name: deployment-manager-role
  apiGroup: rbac.authorization.k8s.io
```

**âš¡ æƒé™éªŒè¯**
```bash
# æ£€æŸ¥æœåŠ¡è´¦æˆ·æƒé™
kubectl auth can-i create deployments --as=system:serviceaccount:default:deployment-manager

# æŸ¥çœ‹æœåŠ¡è´¦æˆ·è¯¦ç»†ä¿¡æ¯
kubectl describe serviceaccount deployment-manager

# æµ‹è¯•Tokenæƒé™
TOKEN=$(kubectl create token deployment-manager)
kubectl --token=$TOKEN get deployments
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ é«˜çº§å‘½ä»¤çš„æœ¬è´¨**
```
â€¢ kubectl diffï¼šå˜æ›´é¢„è§ˆï¼Œç¡®ä¿å®‰å…¨éƒ¨ç½²
â€¢ kubectl waitï¼šåŒæ­¥ç­‰å¾…ï¼Œä¿è¯æ“ä½œé¡ºåº
â€¢ kubectl create job --fromï¼šå¿«é€Ÿä»»åŠ¡æ‰§è¡Œ
â€¢ kubectl alpha debugï¼šä¸´æ—¶è°ƒè¯•ï¼Œé—®é¢˜æ’æŸ¥
â€¢ kubectl certificateï¼šè¯ä¹¦ç®¡ç†ï¼Œå®‰å…¨ä¿éšœ
â€¢ kubectl get --rawï¼šåŸå§‹æ•°æ®ï¼Œæ·±åº¦ç›‘æ§
â€¢ kubectl create tokenï¼šèº«ä»½éªŒè¯ï¼Œæƒé™æ§åˆ¶
```

### 8.2 å®é™…åº”ç”¨çš„å…³é”®ç†è§£


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿™äº›é«˜çº§åŠŸèƒ½**
```
ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼š
â€¢ ä½¿ç”¨diffé¢„æ£€å˜æ›´å†…å®¹
â€¢ ä½¿ç”¨waitç¡®ä¿éƒ¨ç½²é¡ºåº
â€¢ ä½¿ç”¨è¯ä¹¦ç®¡ç†ä¿éšœå®‰å…¨

æ•…éšœæ’æŸ¥æ—¶ï¼š
â€¢ ä½¿ç”¨debugå®¹å™¨æ·±å…¥åˆ†æ
â€¢ ä½¿ç”¨åŸå§‹APIè·å–è¯¦ç»†ä¿¡æ¯
â€¢ ä½¿ç”¨waitç­‰å¾…èµ„æºçŠ¶æ€ç¨³å®š

è‡ªåŠ¨åŒ–è¿ç»´ï¼š
â€¢ åœ¨è„šæœ¬ä¸­ä½¿ç”¨waitæ§åˆ¶æµç¨‹
â€¢ ä½¿ç”¨Tokenä¸ºè‡ªåŠ¨åŒ–å·¥å…·æä¾›æƒé™
â€¢ ä½¿ç”¨åŸå§‹APIè·å–ç›‘æ§æ•°æ®
```

**ğŸ”¹ å®‰å…¨ä½¿ç”¨çš„é‡è¦åŸåˆ™**
```
æƒé™æœ€å°åŒ–ï¼š
â€¢ ä¸ºæ¯ä¸ªåº”ç”¨åˆ›å»ºä¸“ç”¨æœåŠ¡è´¦æˆ·
â€¢ åªæˆäºˆå¿…è¦çš„æœ€å°æƒé™
â€¢ å®šæœŸå®¡æ ¸å’Œæ¸…ç†æ— ç”¨è´¦æˆ·

è¯ä¹¦ç®¡ç†ï¼š
â€¢ ä»”ç»†å®¡æ ¸æ‰€æœ‰CSRè¯·æ±‚
â€¢ ä¸æ‰¹å‡†æ¥æºä¸æ˜çš„è¯ä¹¦ç”³è¯·
â€¢ å®šæœŸè½®æ¢å’Œæ›´æ–°è¯ä¹¦

è°ƒè¯•å®‰å…¨ï¼š
â€¢ AlphaåŠŸèƒ½ä»…åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨
â€¢ è°ƒè¯•å®ŒæˆååŠæ—¶æ¸…ç†å®¹å™¨
â€¢ ä¸åœ¨è°ƒè¯•å®¹å™¨ä¸­ä¿å­˜æ•æ„Ÿä¿¡æ¯
```

### 8.3 å­¦ä¹ å»ºè®®ä¸å®è·µè·¯å¾„


**ğŸ“– å­¦ä¹ é¡ºåºå»ºè®®**
```
1. å…ˆæŒæ¡åŸºç¡€kubectlå‘½ä»¤
2. ç†è§£KubernetesåŸºæœ¬æ¦‚å¿µå’Œæ¶æ„
3. åœ¨æµ‹è¯•ç¯å¢ƒç»ƒä¹ é«˜çº§åŠŸèƒ½
4. ç»“åˆå®é™…åœºæ™¯ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬
5. å­¦ä¹ å®‰å…¨æœ€ä½³å®è·µ
```

**ğŸ› ï¸ å®è·µç»ƒä¹ å»ºè®®**
```
åˆçº§ç»ƒä¹ ï¼š
â€¢ ä½¿ç”¨diffå‘½ä»¤é¢„æ£€é…ç½®æ›´æ”¹
â€¢ ç¼–å†™ç®€å•çš„ç­‰å¾…è„šæœ¬
â€¢ åˆ›å»ºå’Œç®¡ç†æœåŠ¡è´¦æˆ·Token

ä¸­çº§ç»ƒä¹ ï¼š
â€¢ æ­å»ºå®Œæ•´çš„CI/CDéƒ¨ç½²æµç¨‹
â€¢ å®ç°èµ„æºç›‘æ§å’Œå‘Šè­¦è„šæœ¬
â€¢ ç®¡ç†é›†ç¾¤è¯ä¹¦ç”Ÿå‘½å‘¨æœŸ

é«˜çº§åº”ç”¨ï¼š
â€¢ æ„å»ºå¤šç¯å¢ƒè‡ªåŠ¨åŒ–éƒ¨ç½²ç³»ç»Ÿ
â€¢ å®ç°å¤æ‚çš„æ•…éšœè‡ªåŠ¨æ¢å¤æœºåˆ¶
â€¢ å¼€å‘è‡ªå®šä¹‰çš„é›†ç¾¤ç®¡ç†å·¥å…·
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- é«˜çº§å‘½ä»¤æ˜¯kubectlçš„"ç‘å£«å†›åˆ€"ï¼Œæ¯ä¸ªéƒ½æœ‰ç‰¹å®šç”¨é€”
- diffå’Œwaitæ˜¯å®‰å…¨éƒ¨ç½²çš„å¿…å¤‡å·¥å…·
- è¯ä¹¦å’ŒTokenç®¡ç†å…³ç³»åˆ°é›†ç¾¤å®‰å…¨
- åŸå§‹APIè®¿é—®æä¾›äº†æœ€å¤§çš„çµæ´»æ€§
- å®è·µä¸­è¦å¹³è¡¡åŠŸèƒ½æ€§å’Œå®‰å…¨æ€§