---
title: 21ã€RBACæƒé™ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [RBACæƒé™ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-RBACæƒé™ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [è§’è‰²æŸ¥çœ‹ä¸ç®¡ç†å‘½ä»¤](#2-è§’è‰²æŸ¥çœ‹ä¸ç®¡ç†å‘½ä»¤)
3. [è§’è‰²ç»‘å®šæ“ä½œè¯¦è§£](#3-è§’è‰²ç»‘å®šæ“ä½œè¯¦è§£)
4. [é›†ç¾¤çº§æƒé™ç®¡ç†](#4-é›†ç¾¤çº§æƒé™ç®¡ç†)
5. [æƒé™éªŒè¯ä¸æ£€æŸ¥](#5-æƒé™éªŒè¯ä¸æ£€æŸ¥)
6. [å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹](#6-å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹)
7. [æƒé™æ•…éšœæ’æŸ¥æŠ€å·§](#7-æƒé™æ•…éšœæ’æŸ¥æŠ€å·§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” RBACæƒé™ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯RBACæƒé™ç®¡ç†

ğŸ¯ **é€šä¿—ç†è§£**ï¼šRBACå°±åƒå…¬å¸çš„é—¨ç¦ç³»ç»Ÿï¼Œä¸åŒçš„å‘˜å·¥æœ‰ä¸åŒçš„é—¨å¡æƒé™

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
å…¬å¸é—¨ç¦ç³»ç»Ÿ â†’ Kubernetes RBACç³»ç»Ÿ
  
å‘˜å·¥èº«ä»½      â†’  ç”¨æˆ·(User)
éƒ¨é—¨èŒä½      â†’  è§’è‰²(Role) 
é—¨å¡æƒé™      â†’  æƒé™(Permission)
åˆ†é…é—¨å¡      â†’  è§’è‰²ç»‘å®š(RoleBinding)
```

**ğŸ”¸ RBACæ ¸å¿ƒç»„ä»¶å…³ç³»å›¾**
```
ç”¨æˆ·/æœåŠ¡è´¦æˆ·(Subject)
        â†“
é€šè¿‡è§’è‰²ç»‘å®š(Binding)
        â†“  
è·å¾—è§’è‰²æƒé™(Role)
        â†“
æ“ä½œé›†ç¾¤èµ„æº(Resources)
```

### 1.2 RBACå››å¤§æ ¸å¿ƒæ¦‚å¿µè¯¦è§£


**ğŸ“‹ æƒé™ç®¡ç†çš„å››ä¸ªå…³é”®è§’è‰²**

| ç»„ä»¶ | **ä½œç”¨è¯´æ˜** | **ç”Ÿæ´»ç±»æ¯”** | **é€‚ç”¨èŒƒå›´** |
|------|-------------|-------------|-------------|
| ğŸ”¸ **Role** | `å®šä¹‰å¯ä»¥åšä»€ä¹ˆæ“ä½œ` | `éƒ¨é—¨ç»ç†èŒè´£` | `å•ä¸ªå‘½åç©ºé—´` |
| ğŸ”¸ **ClusterRole** | `å®šä¹‰é›†ç¾¤çº§æ“ä½œæƒé™` | `å…¬å¸é«˜ç®¡æƒé™` | `æ•´ä¸ªé›†ç¾¤` |
| ğŸ”¸ **RoleBinding** | `å°†ç”¨æˆ·ç»‘å®šåˆ°è§’è‰²` | `ç»™å‘˜å·¥åˆ†é…èŒä½` | `å•ä¸ªå‘½åç©ºé—´` |
| ğŸ”¸ **ClusterRoleBinding** | `å°†ç”¨æˆ·ç»‘å®šåˆ°é›†ç¾¤è§’è‰²` | `ä»»å‘½å…¬å¸é«˜ç®¡` | `æ•´ä¸ªé›†ç¾¤` |

### 1.3 æƒé™æ§åˆ¶çš„å·¥ä½œæµç¨‹

**ğŸ”„ ä»è¯·æ±‚åˆ°æˆæƒçš„å®Œæ•´è¿‡ç¨‹**

```
æ­¥éª¤1ï¼šç”¨æˆ·å‘èµ·è¯·æ±‚
kubectl get pods  â† ç”¨æˆ·æƒ³æŸ¥çœ‹Pod

æ­¥éª¤2ï¼šèº«ä»½éªŒè¯
ç³»ç»Ÿç¡®è®¤ï¼šè¿™æ˜¯è°ï¼Ÿ

æ­¥éª¤3ï¼šæƒé™æ£€æŸ¥
ç³»ç»Ÿæ£€æŸ¥ï¼šè¿™ä¸ªç”¨æˆ·æœ‰æŸ¥çœ‹Podçš„æƒé™å—ï¼Ÿ

æ­¥éª¤4ï¼šæ‰§è¡Œæ“ä½œ
æœ‰æƒé™ â†’ è¿”å›Podåˆ—è¡¨
æ— æƒé™ â†’ è¿”å›403 Forbiddené”™è¯¯
```

**ğŸ’¡ æƒé™æ£€æŸ¥çš„ä¸‰è¦ç´ **
- **Whoï¼ˆè°ï¼‰**ï¼šç”¨æˆ·èº«ä»½æˆ–æœåŠ¡è´¦æˆ·
- **Whatï¼ˆä»€ä¹ˆï¼‰**ï¼šè¦æ‰§è¡Œçš„æ“ä½œï¼ˆæŸ¥çœ‹ã€åˆ›å»ºã€åˆ é™¤ç­‰ï¼‰
- **Whereï¼ˆå“ªé‡Œï¼‰**ï¼šæ“ä½œçš„èµ„æºèŒƒå›´ï¼ˆPodã€Serviceç­‰ï¼‰

---

## 2. ğŸ‘€ è§’è‰²æŸ¥çœ‹ä¸ç®¡ç†å‘½ä»¤


### 2.1 æŸ¥çœ‹ç°æœ‰è§’è‰²

**ğŸ” äº†è§£å½“å‰ç³»ç»Ÿä¸­æœ‰å“ªäº›è§’è‰²**

```bash
# æŸ¥çœ‹å½“å‰å‘½åç©ºé—´çš„æ‰€æœ‰è§’è‰²
kubectl get roles

# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´çš„è§’è‰²
kubectl get roles --all-namespaces

# æŸ¥çœ‹ç‰¹å®šå‘½åç©ºé—´çš„è§’è‰²
kubectl get roles -n kube-system
```

**ğŸ“Š è§’è‰²åˆ—è¡¨è§£è¯»**
```
è¾“å‡ºç¤ºä¾‹ï¼š
NAME          CREATED AT
pod-reader    2024-01-15T10:30:00Z
deployment-manager  2024-01-16T14:20:00Z

å­—æ®µå«ä¹‰ï¼š
NAMEï¼šè§’è‰²åç§°
CREATED ATï¼šè§’è‰²åˆ›å»ºæ—¶é—´
```

### 2.2 æŸ¥çœ‹è§’è‰²è¯¦ç»†ä¿¡æ¯

**ğŸ” æ·±å…¥äº†è§£è§’è‰²å…·ä½“æƒé™**

```bash
# æŸ¥çœ‹è§’è‰²è¯¦ç»†æƒé™
kubectl describe role pod-reader

# æŒ‡å®šå‘½åç©ºé—´æŸ¥çœ‹è§’è‰²
kubectl describe role pod-reader -n default
```

**ğŸ’¡ è§’è‰²è¯¦æƒ…è§£è¯»**
```
è¾“å‡ºç¤ºä¾‹ï¼š
Name:         pod-reader
Namespace:    default
PolicyRule:
  Resources  Non-Resource URLs  Resource Names  Verbs
  ---------  -----------------  --------------  -----
  pods       []                 []              [get list watch]

å«ä¹‰è§£é‡Šï¼š
Resourcesï¼šå¯ä»¥æ“ä½œçš„èµ„æºç±»å‹ï¼ˆè¿™é‡Œæ˜¯podsï¼‰
Verbsï¼šå…è®¸çš„æ“ä½œåŠ¨ä½œï¼ˆget=æŸ¥çœ‹å•ä¸ªï¼Œlist=åˆ—å‡ºï¼Œwatch=ç›‘æ§å˜åŒ–ï¼‰
```

### 2.3 å¯¼å‡ºè§’è‰²é…ç½®

**ğŸ“ å¤‡ä»½å’Œå¤ç”¨è§’è‰²é…ç½®**

```bash
# å¯¼å‡ºè§’è‰²ä¸ºYAMLæ ¼å¼
kubectl get role pod-reader -o yaml > pod-reader-role.yaml

# å¯¼å‡ºè§’è‰²ä¸ºJSONæ ¼å¼
kubectl get role pod-reader -o json > pod-reader-role.json
```

---

## 3. ğŸ”— è§’è‰²ç»‘å®šæ“ä½œè¯¦è§£


### 3.1 æŸ¥çœ‹è§’è‰²ç»‘å®šå…³ç³»

**ğŸ‘¥ äº†è§£ç”¨æˆ·å’Œè§’è‰²çš„å¯¹åº”å…³ç³»**

```bash
# æŸ¥çœ‹å½“å‰å‘½åç©ºé—´çš„è§’è‰²ç»‘å®š
kubectl get rolebindings

# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´çš„è§’è‰²ç»‘å®š
kubectl get rolebindings --all-namespaces

# æŸ¥çœ‹ç‰¹å®šè§’è‰²ç»‘å®šè¯¦æƒ…
kubectl describe rolebinding pod-reader-binding
```

**ğŸ“‹ è§’è‰²ç»‘å®šä¿¡æ¯è§£è¯»**
```
è¾“å‡ºç¤ºä¾‹ï¼š
Name:         pod-reader-binding
Namespace:    default
Role:
  Kind:  Role
  Name:  pod-reader
Subjects:
  Kind  Name        Namespace
  ----  ----        ---------
  User  alice       
  User  bob         

è§£è¯»è¯´æ˜ï¼š
Roleï¼šç»‘å®šçš„è§’è‰²åç§°
Subjectsï¼šè¢«æˆæƒçš„ç”¨æˆ·åˆ—è¡¨ï¼ˆè¿™é‡Œæ˜¯aliceå’Œbobä¸¤ä¸ªç”¨æˆ·ï¼‰
```

### 3.2 åˆ›å»ºè§’è‰²ç»‘å®š

**ğŸ”§ ç»™ç”¨æˆ·åˆ†é…æƒé™çš„å®é™…æ“ä½œ**

```bash
# å°†ç”¨æˆ·ç»‘å®šåˆ°ç°æœ‰è§’è‰²
kubectl create rolebinding alice-pod-reader \
  --role=pod-reader \
  --user=alice

# å°†æœåŠ¡è´¦æˆ·ç»‘å®šåˆ°è§’è‰²
kubectl create rolebinding myapp-pod-reader \
  --role=pod-reader \
  --serviceaccount=default:myapp

# å°†ç”¨æˆ·ç»„ç»‘å®šåˆ°è§’è‰²
kubectl create rolebinding developers-pod-reader \
  --role=pod-reader \
  --group=developers
```

**ğŸ’¡ ç»‘å®šå¯¹è±¡ç±»å‹è¯´æ˜**
- **--user**ï¼šæ™®é€šç”¨æˆ·ï¼ˆå¦‚aliceã€bobï¼‰
- **--serviceaccount**ï¼šæœåŠ¡è´¦æˆ·ï¼ˆæ ¼å¼ï¼šnamespace:account-nameï¼‰
- **--group**ï¼šç”¨æˆ·ç»„ï¼ˆå¦‚developersã€adminsï¼‰

### 3.3 ä¿®æ”¹å’Œåˆ é™¤è§’è‰²ç»‘å®š

**âœï¸ æƒé™è°ƒæ•´å’Œæ¸…ç†æ“ä½œ**

```bash
# åˆ é™¤è§’è‰²ç»‘å®š
kubectl delete rolebinding alice-pod-reader

# ç¼–è¾‘ç°æœ‰è§’è‰²ç»‘å®š
kubectl edit rolebinding pod-reader-binding

# æ‰¹é‡åˆ é™¤è§’è‰²ç»‘å®š
kubectl delete rolebindings --all -n test-namespace
```

---

## 4. ğŸŒ é›†ç¾¤çº§æƒé™ç®¡ç†


### 4.1 é›†ç¾¤è§’è‰²ç®¡ç†

**âš¡ é›†ç¾¤çº§æƒé™çš„æŸ¥çœ‹å’Œæ“ä½œ**

```bash
# æŸ¥çœ‹æ‰€æœ‰é›†ç¾¤è§’è‰²
kubectl get clusterroles

# æŸ¥çœ‹ç³»ç»Ÿå†…ç½®çš„é‡è¦é›†ç¾¤è§’è‰²
kubectl get clusterroles | grep -E "(admin|edit|view)"

# æŸ¥çœ‹ç‰¹å®šé›†ç¾¤è§’è‰²è¯¦æƒ…
kubectl describe clusterrole cluster-admin
```

**ğŸ”¸ å¸¸è§ç³»ç»Ÿå†…ç½®è§’è‰²**
```
cluster-adminï¼šé›†ç¾¤è¶…çº§ç®¡ç†å‘˜æƒé™
adminï¼šå‘½åç©ºé—´ç®¡ç†å‘˜æƒé™  
editï¼šèµ„æºç¼–è¾‘æƒé™
viewï¼šåªè¯»æŸ¥çœ‹æƒé™
system:*ï¼šç³»ç»Ÿç»„ä»¶ä¸“ç”¨æƒé™
```

### 4.2 é›†ç¾¤è§’è‰²ç»‘å®šç®¡ç†

**ğŸ”— é›†ç¾¤çº§æƒé™åˆ†é…**

```bash
# æŸ¥çœ‹é›†ç¾¤è§’è‰²ç»‘å®š
kubectl get clusterrolebindings

# æŸ¥çœ‹ç‰¹å®šç»‘å®šè¯¦æƒ…
kubectl describe clusterrolebinding cluster-admin

# åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š
kubectl create clusterrolebinding alice-cluster-admin \
  --clusterrole=cluster-admin \
  --user=alice
```

**âš ï¸ é›†ç¾¤æƒé™å®‰å…¨æé†’**
```
é›†ç¾¤è§’è‰²ç»‘å®šçš„å½±å“èŒƒå›´ï¼š
âœ“ ä½œç”¨äºæ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰å‘½åç©ºé—´
âœ“ æƒé™çº§åˆ«é€šå¸¸å¾ˆé«˜ï¼Œéœ€è°¨æ…åˆ†é…
âœ“ è¯¯æ“ä½œå¯èƒ½å½±å“æ•´ä¸ªé›†ç¾¤ç¨³å®šæ€§

å®‰å…¨å»ºè®®ï¼š
- ä¼˜å…ˆä½¿ç”¨å‘½åç©ºé—´çº§è§’è‰²
- å®šæœŸå®¡æŸ¥é›†ç¾¤çº§æƒé™åˆ†é…
- éµå¾ªæœ€å°æƒé™åŸåˆ™
```

---

## 5. âœ… æƒé™éªŒè¯ä¸æ£€æŸ¥


### 5.1 æ£€æŸ¥è‡ªå·±çš„æƒé™

**ğŸ” ç¡®è®¤å½“å‰ç”¨æˆ·èƒ½åšä»€ä¹ˆæ“ä½œ**

```bash
# æ£€æŸ¥æ˜¯å¦èƒ½æŸ¥çœ‹Pod
kubectl auth can-i get pods

# æ£€æŸ¥æ˜¯å¦èƒ½åœ¨ç‰¹å®šå‘½åç©ºé—´åˆ›å»ºéƒ¨ç½²
kubectl auth can-i create deployments -n production

# æ£€æŸ¥æ‰€æœ‰æƒé™æ¦‚è§ˆ
kubectl auth can-i --list
```

**ğŸ’¡ æƒé™æ£€æŸ¥ç»“æœè§£è¯»**
```
å‘½ä»¤è¾“å‡ºç»“æœï¼š
yesï¼šæœ‰æƒé™æ‰§è¡Œè¯¥æ“ä½œ
noï¼šæ²¡æœ‰æƒé™æ‰§è¡Œè¯¥æ“ä½œ
errorï¼šæ£€æŸ¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯

å®é™…åº”ç”¨ï¼š
åœ¨æ‰§è¡Œæ•æ„Ÿæ“ä½œå‰å…ˆæ£€æŸ¥æƒé™ï¼Œé¿å…æ‰§è¡Œå¤±è´¥
```

### 5.2 æ¨¡æ‹Ÿå…¶ä»–ç”¨æˆ·æ£€æŸ¥æƒé™

**ğŸ‘¤ ä»¥ç®¡ç†å‘˜èº«ä»½æ£€æŸ¥å…¶ä»–ç”¨æˆ·æƒé™**

```bash
# æ¨¡æ‹Ÿaliceç”¨æˆ·æ£€æŸ¥æƒé™
kubectl auth can-i get pods --as=alice

# æ¨¡æ‹ŸæœåŠ¡è´¦æˆ·æ£€æŸ¥æƒé™
kubectl auth can-i create services --as=system:serviceaccount:default:myapp

# æ£€æŸ¥ç”¨æˆ·åœ¨ç‰¹å®šå‘½åç©ºé—´çš„æƒé™
kubectl auth can-i delete pods --as=bob -n production
```

**ğŸ”§ æƒé™è¯Šæ–­æŠ€å·§**
```
é—®é¢˜æ’æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤ç”¨æˆ·èº«ä»½æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥è§’è‰²æ˜¯å¦å­˜åœ¨
3. éªŒè¯è§’è‰²ç»‘å®šæ˜¯å¦æ­£ç¡®
4. ç¡®è®¤èµ„æºå’ŒåŠ¨ä½œæ˜¯å¦åŒ¹é…
```

### 5.3 æƒé™æµ‹è¯•è„šæœ¬

**ğŸ¤– è‡ªåŠ¨åŒ–æƒé™éªŒè¯**

```bash
#!/bin/bash
# æƒé™æ£€æŸ¥è„šæœ¬ç¤ºä¾‹

USER="alice"
NAMESPACE="production"

echo "æ£€æŸ¥ç”¨æˆ· $USER åœ¨ $NAMESPACE å‘½åç©ºé—´çš„æƒé™ï¼š"

# å®šä¹‰è¦æ£€æŸ¥çš„æ“ä½œåˆ—è¡¨
OPERATIONS=(
  "get pods"
  "list pods" 
  "create pods"
  "delete pods"
  "get services"
  "create deployments"
)

# é€ä¸€æ£€æŸ¥æ¯ä¸ªæ“ä½œæƒé™
for op in "${OPERATIONS[@]}"; do
  result=$(kubectl auth can-i $op --as=$USER -n $NAMESPACE 2>&1)
  if [[ $result == "yes" ]]; then
    echo "âœ… $op"
  else
    echo "âŒ $op"
  fi
done
```

---

## 6. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹


### 6.1 å¼€å‘å›¢é˜Ÿæƒé™è®¾ç½®

**ğŸ‘¨â€ğŸ’» ä¸ºå¼€å‘äººå‘˜è®¾ç½®åˆé€‚çš„æƒé™**

```bash
# åœºæ™¯ï¼šç»™å¼€å‘å›¢é˜Ÿè®¾ç½®å¼€å‘ç¯å¢ƒæƒé™

# 1. åˆ›å»ºå¼€å‘è€…è§’è‰²
kubectl create role developer \
  --verb=get,list,watch,create,update,patch \
  --resource=pods,services,configmaps,secrets

# 2. åˆ›å»ºè§’è‰²ç»‘å®š
kubectl create rolebinding dev-team-binding \
  --role=developer \
  --group=developers \
  -n development

# 3. éªŒè¯æƒé™è®¾ç½®
kubectl auth can-i create pods --as=dev-user -n development
```

**ğŸ“‹ å¼€å‘ç¯å¢ƒæƒé™å»ºè®®**
```
æ¨èæƒé™èŒƒå›´ï¼š
âœ… å…è®¸ï¼šæŸ¥çœ‹ã€åˆ›å»ºã€æ›´æ–°Podå’ŒService
âœ… å…è®¸ï¼šç®¡ç†ConfigMapå’ŒSecret
âŒ ç¦æ­¢ï¼šåˆ é™¤é‡è¦èµ„æº
âŒ ç¦æ­¢ï¼šä¿®æ”¹å‘½åç©ºé—´é…ç½®
```

### 6.2 è¿ç»´å›¢é˜Ÿæƒé™é…ç½®

**ğŸ”§ ä¸ºè¿ç»´äººå‘˜è®¾ç½®è¿ç»´æƒé™**

```bash
# åœºæ™¯ï¼šè¿ç»´å›¢é˜Ÿéœ€è¦æ›´å¹¿æ³›çš„ç®¡ç†æƒé™

# 1. åˆ›å»ºè¿ç»´è§’è‰²ï¼ˆä½¿ç”¨ç³»ç»Ÿå†…ç½®è§’è‰²ï¼‰
kubectl create rolebinding ops-admin-binding \
  --clusterrole=admin \
  --group=operations \
  -n production

# 2. ä¸ºç´§æ€¥æƒ…å†µåˆ›å»ºä¸´æ—¶è¶…çº§æƒé™
kubectl create clusterrolebinding emergency-access \
  --clusterrole=cluster-admin \
  --user=ops-lead
```

### 6.3 åº”ç”¨æœåŠ¡è´¦æˆ·æƒé™

**ğŸ¤– ä¸ºåº”ç”¨ç¨‹åºè®¾ç½®æœåŠ¡è´¦æˆ·æƒé™**

```bash
# åœºæ™¯ï¼šåº”ç”¨éœ€è¦è®¿é—®Kubernetes API

# 1. åˆ›å»ºæœåŠ¡è´¦æˆ·
kubectl create serviceaccount myapp-sa

# 2. åˆ›å»ºåº”ç”¨ä¸“ç”¨è§’è‰²
kubectl create role app-role \
  --verb=get,list,watch \
  --resource=pods,services

# 3. ç»‘å®šæœåŠ¡è´¦æˆ·åˆ°è§’è‰²
kubectl create rolebinding myapp-binding \
  --role=app-role \
  --serviceaccount=default:myapp-sa

# 4. åœ¨Podä¸­ä½¿ç”¨æœåŠ¡è´¦æˆ·
# åœ¨Podçš„YAMLä¸­æ·»åŠ ï¼š
# serviceAccountName: myapp-sa
```

---

## 7. ğŸš¨ æƒé™æ•…éšœæ’æŸ¥æŠ€å·§


### 7.1 å¸¸è§æƒé™é”™è¯¯åˆ†æ

**ğŸ” å¿«é€Ÿå®šä½æƒé™é—®é¢˜**

**âŒ é”™è¯¯1ï¼š403 Forbidden**
```
é”™è¯¯ç°è±¡ï¼š
kubectl get pods
Error from server (Forbidden): pods is forbidden: User "alice" cannot get resource "pods"

æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨è§’è‰²ç»‘å®š
   kubectl get rolebindings | grep alice

2. æ£€æŸ¥è§’è‰²æ˜¯å¦åŒ…å«æ‰€éœ€æƒé™
   kubectl describe role [role-name]

3. æ£€æŸ¥å‘½åç©ºé—´æ˜¯å¦æ­£ç¡®
   kubectl get pods -n [correct-namespace]
```

**âŒ é”™è¯¯2ï¼šè§’è‰²ä¸å­˜åœ¨**
```
é”™è¯¯ç°è±¡ï¼š
rolebindings.rbac.authorization.k8s.io "test-binding" is forbidden

è§£å†³æ–¹æ¡ˆï¼š
1. ç¡®è®¤è§’è‰²åç§°æ‹¼å†™æ­£ç¡®
2. æ£€æŸ¥è§’è‰²æ˜¯å¦åœ¨æ­£ç¡®çš„å‘½åç©ºé—´
3. éªŒè¯è§’è‰²æ˜¯å¦å·²åˆ›å»ºæˆåŠŸ
```

### 7.2 æƒé™é—®é¢˜è¯Šæ–­å·¥å…·

**ğŸ› ï¸ ç³»ç»ŸåŒ–æ’æŸ¥æ–¹æ³•**

```bash
# æƒé™è¯Šæ–­è„šæœ¬
#!/bin/bash
USER=$1
NAMESPACE=${2:-default}

echo "=== æƒé™è¯Šæ–­æŠ¥å‘Š ==="
echo "ç”¨æˆ·ï¼š$USER"
echo "å‘½åç©ºé—´ï¼š$NAMESPACE"
echo

# æ£€æŸ¥è§’è‰²ç»‘å®š
echo "1. æ£€æŸ¥è§’è‰²ç»‘å®šï¼š"
kubectl get rolebindings -n $NAMESPACE -o wide | grep $USER

# æ£€æŸ¥é›†ç¾¤è§’è‰²ç»‘å®š
echo "2. æ£€æŸ¥é›†ç¾¤è§’è‰²ç»‘å®šï¼š"
kubectl get clusterrolebindings -o wide | grep $USER

# æ£€æŸ¥æƒé™åˆ—è¡¨
echo "3. ç”¨æˆ·æƒé™åˆ—è¡¨ï¼š"
kubectl auth can-i --list --as=$USER -n $NAMESPACE

# æ£€æŸ¥å¸¸ç”¨æ“ä½œæƒé™
echo "4. å¸¸ç”¨æ“ä½œæƒé™æ£€æŸ¥ï¼š"
COMMON_OPS=("get pods" "create pods" "delete pods" "get services")
for op in "${COMMON_OPS[@]}"; do
  result=$(kubectl auth can-i $op --as=$USER -n $NAMESPACE)
  printf "%-20s %s\n" "$op:" "$result"
done
```

### 7.3 æƒé™ä¿®å¤å¸¸è§æ–¹æ³•

**ğŸ”§ å¿«é€Ÿä¿®å¤æƒé™é—®é¢˜**

```bash
# ä¿®å¤æ–¹æ³•1ï¼šé‡æ–°åˆ›å»ºè§’è‰²ç»‘å®š
kubectl delete rolebinding problem-binding
kubectl create rolebinding fixed-binding \
  --role=correct-role \
  --user=target-user

# ä¿®å¤æ–¹æ³•2ï¼šç¼–è¾‘ç°æœ‰ç»‘å®š
kubectl edit rolebinding existing-binding

# ä¿®å¤æ–¹æ³•3ï¼šä¸´æ—¶æå‡æƒé™ï¼ˆç´§æ€¥æƒ…å†µï¼‰
kubectl create clusterrolebinding temp-admin \
  --clusterrole=cluster-admin \
  --user=emergency-user
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ RBACå››å¤§ç»„ä»¶ï¼šRoleã€RoleBindingã€ClusterRoleã€ClusterRoleBinding
ğŸ”¸ æƒé™ä¸‰è¦ç´ ï¼šä¸»ä½“(Who)ã€åŠ¨ä½œ(What)ã€èµ„æº(Where)
ğŸ”¸ å‘½åç©ºé—´æƒé™ vs é›†ç¾¤æƒé™çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯
ğŸ”¸ æƒé™æ£€æŸ¥å‘½ä»¤ï¼šcan-i ç³»åˆ—å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•
ğŸ”¸ æ•…éšœæ’æŸ¥ï¼šå¸¸è§æƒé™é”™è¯¯çš„è¯Šæ–­å’Œä¿®å¤æ–¹æ³•
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ RBACæƒé™ç®¡ç†çš„æ ¸å¿ƒæ€æƒ³**
```
æœ€å°æƒé™åŸåˆ™ï¼š
- ç”¨æˆ·åªè·å¾—å®Œæˆå·¥ä½œæ‰€éœ€çš„æœ€å°æƒé™
- å®šæœŸå®¡æŸ¥å’Œå›æ”¶ä¸å¿…è¦çš„æƒé™
- åŒºåˆ†å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„æƒé™ç­‰çº§

è§’è‰²åˆ†ç¦»ç­–ç•¥ï¼š
- å¼€å‘äººå‘˜ï¼šæœ‰é™çš„åˆ›å»ºå’Œä¿®æ”¹æƒé™
- è¿ç»´äººå‘˜ï¼šè¾ƒå¹¿æ³›çš„ç®¡ç†æƒé™  
- åº”ç”¨ç¨‹åºï¼šä»…è®¿é—®å¿…éœ€çš„APIæƒé™
```

**ğŸ”¹ å‘½ä»¤ä½¿ç”¨æŠ€å·§è®°å¿†**
```
æŸ¥çœ‹ç±»å‘½ä»¤ï¼ˆget/describeï¼‰ï¼š
kubectl get roles/rolebindings
kubectl describe role/rolebinding [name]

åˆ›å»ºç±»å‘½ä»¤ï¼ˆcreateï¼‰ï¼š
kubectl create role [name] --verb=... --resource=...
kubectl create rolebinding [name] --role=... --user=...

éªŒè¯ç±»å‘½ä»¤ï¼ˆauth can-iï¼‰ï¼š
kubectl auth can-i [verb] [resource]
kubectl auth can-i [verb] [resource] --as=[user]
```

**ğŸ”¹ æƒé™è®¾è®¡æœ€ä½³å®è·µ**
```
æƒé™è§„åˆ’åŸåˆ™ï¼š
1. å…ˆè§„åˆ’è§’è‰²ï¼Œå†åˆ†é…ç”¨æˆ·
2. ä¼˜å…ˆä½¿ç”¨å‘½åç©ºé—´çº§æƒé™
3. è°¨æ…åˆ†é…é›†ç¾¤çº§æƒé™
4. å»ºç«‹æƒé™ç”³è¯·å’Œå®¡æ‰¹æµç¨‹

å®‰å…¨å»ºè®®ï¼š
- å®šæœŸå®¡è®¡æƒé™åˆ†é…æƒ…å†µ
- ä½¿ç”¨æœåŠ¡è´¦æˆ·è€Œéä¸ªäººè´¦æˆ·ç»™åº”ç”¨æˆæƒ
- å®æ–½æƒé™å˜æ›´çš„è®°å½•å’Œç›‘æ§
- å»ºç«‹ç´§æ€¥æƒé™å›æ”¶æœºåˆ¶
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒåº”ç”¨åœºæ™¯**
- **å¤šå›¢é˜Ÿåä½œ**ï¼šä¸åŒå›¢é˜Ÿæœ‰ä¸åŒçš„èµ„æºè®¿é—®æƒé™
- **ç¯å¢ƒéš”ç¦»**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„æƒé™åˆ†ç¦»
- **åº”ç”¨å®‰å…¨**ï¼šé™åˆ¶åº”ç”¨ç¨‹åºçš„APIè®¿é—®èŒƒå›´
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³ä¼ä¸šå®‰å…¨å’Œå®¡è®¡è¦æ±‚

**ğŸ”§ æ—¥å¸¸è¿ç»´å®è·µ**
- **æƒé™æ•…éšœæ’æŸ¥**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³æƒé™ç›¸å…³é—®é¢˜
- **æ–°ç”¨æˆ·å…¥èŒ**ï¼šæ ‡å‡†åŒ–çš„æƒé™åˆ†é…æµç¨‹
- **æƒé™å®¡è®¡**ï¼šå®šæœŸæ£€æŸ¥å’Œæ¸…ç†è¿‡æœŸæƒé™
- **åº”æ€¥å¤„ç†**ï¼šç´§æ€¥æƒ…å†µä¸‹çš„æƒé™ä¸´æ—¶è°ƒæ•´

**å­¦ä¹ è¿›åº¦æ£€æŸ¥ï¼š**
- [ ] ç†è§£RBACå››å¤§ç»„ä»¶çš„ä½œç”¨å’Œå…³ç³»
- [ ] æŒæ¡è§’è‰²æŸ¥çœ‹å’Œç®¡ç†çš„åŸºæœ¬å‘½ä»¤
- [ ] èƒ½å¤Ÿåˆ›å»ºå’Œç®¡ç†è§’è‰²ç»‘å®š
- [ ] å­¦ä¼šä½¿ç”¨æƒé™éªŒè¯å‘½ä»¤æ’æŸ¥é—®é¢˜
- [ ] äº†è§£ä¸åŒåœºæ™¯ä¸‹çš„æƒé™è®¾è®¡ç­–ç•¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å››å¤§ç»„ä»¶è¦åˆ†æ¸…ï¼šè§’è‰²å®šä¹‰ï¼Œç»‘å®šåˆ†é…
- æŸ¥çœ‹å‘½ä»¤get describeï¼Œåˆ›å»ºç»‘å®šè¦å‡†ç¡®
- æƒé™éªŒè¯can-iç”¨ï¼Œæ¨¡æ‹Ÿæ£€æŸ¥aså‚æ•°
- æœ€å°æƒé™æ˜¯åŸåˆ™ï¼Œå®‰å…¨ç¬¬ä¸€è¦ç‰¢è®°