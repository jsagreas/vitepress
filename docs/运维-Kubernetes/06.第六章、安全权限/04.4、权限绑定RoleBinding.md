---
title: 4ã€æƒé™ç»‘å®šRoleBinding
---
## ğŸ“š ç›®å½•

1. [æƒé™ç»‘å®šæ¦‚å¿µå…¥é—¨](#1-æƒé™ç»‘å®šæ¦‚å¿µå…¥é—¨)
2. [RoleBindingè§’è‰²ç»‘å®šè¯¦è§£](#2-RoleBindingè§’è‰²ç»‘å®šè¯¦è§£)
3. [ClusterRoleBindingé›†ç¾¤è§’è‰²ç»‘å®š](#3-ClusterRoleBindingé›†ç¾¤è§’è‰²ç»‘å®š)
4. [ä¸»ä½“Subjectæ·±åº¦ç†è§£](#4-ä¸»ä½“Subjectæ·±åº¦ç†è§£)
5. [æƒé™ç»‘å®šå®æˆ˜æ“ä½œ](#5-æƒé™ç»‘å®šå®æˆ˜æ“ä½œ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— æƒé™ç»‘å®šæ¦‚å¿µå…¥é—¨


### 1.1 ä»€ä¹ˆæ˜¯æƒé™ç»‘å®š


**ğŸ¯ ç”Ÿæ´»åŒ–ç†è§£**

> æƒ³è±¡ä¸€ä¸‹å…¬å¸çš„é—¨ç¦ç³»ç»Ÿï¼šä½ æœ‰ä¸€å¼ å‘˜å·¥å¡ï¼ˆç”¨æˆ·èº«ä»½ï¼‰ï¼Œå…¬å¸æœ‰å„ç§æƒé™è§„åˆ™ï¼ˆæ¯”å¦‚"å¯ä»¥è¿›å…¥åŠå…¬åŒº"ã€"å¯ä»¥ä½¿ç”¨æ‰“å°æœº"ï¼‰ï¼Œä½†æ˜¯è¿™å¼ å¡å’Œè§„åˆ™ä¹‹é—´éœ€è¦æœ‰ä¸€ä¸ª**è¿æ¥å…³ç³»**ï¼Œè¿™ä¸ªè¿æ¥å°±æ˜¯æƒé™ç»‘å®šã€‚

```
ç°å®ä¸–ç•Œçš„æƒé™ç³»ç»Ÿï¼š

å‘˜å·¥å¼ ä¸‰ â”€â”€â”€â”€â”€â”€â”€â”€â”
              æƒé™ç»‘å®š â”€â”€â”€â”€â†’ å¯ä»¥è¿›å…¥ç ”å‘éƒ¨
ç ”å‘éƒ¨é—¨æƒé™è§„åˆ™ â”€â”€â”€â”€â”˜      å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨

å‘˜å·¥æå›› â”€â”€â”€â”€â”€â”€â”€â”€â”
              æƒé™ç»‘å®š â”€â”€â”€â”€â†’ å¯ä»¥è¿›å…¥è´¢åŠ¡éƒ¨
è´¢åŠ¡éƒ¨é—¨æƒé™è§„åˆ™ â”€â”€â”€â”€â”˜      å¯ä»¥æŸ¥çœ‹æŠ¥è¡¨
```

**ğŸ’¡ Kubernetesä¸­çš„æƒé™ç»‘å®š**

åœ¨K8sä¸­ï¼Œæƒé™ç»‘å®šå°±æ˜¯æŠŠ**ç”¨æˆ·/æœåŠ¡è´¦å·**ï¼ˆwhoï¼‰å’Œ**è§’è‰²æƒé™**ï¼ˆwhatï¼‰è¿æ¥èµ·æ¥çš„æ¡¥æ¢ï¼š

```
K8sæƒé™ç»‘å®šå…³ç³»ï¼š

ç”¨æˆ·/ServiceAccount â”€â”€â”€â”€â”€â”€â”€â”€â”
                     RoleBinding â”€â”€â”€â”€â†’ è·å¾—å…·ä½“æƒé™
Role/ClusterRole â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      å¯ä»¥åšä»€ä¹ˆæ“ä½œ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æƒé™ç»‘å®š


**ğŸ”¸ åˆ†ç¦»å¼è®¾è®¡çš„å¥½å¤„**

```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
ç”¨æˆ· = æƒé™ï¼ˆå†™æ­»åœ¨ä¸€èµ·ï¼‰
âœ— éš¾ä»¥ç®¡ç†
âœ— æƒé™å˜æ›´å¤æ‚
âœ— æ— æ³•é‡ç”¨

K8sæ–¹å¼çš„ä¼˜åŠ¿ï¼š
ç”¨æˆ· + è§’è‰² = æƒé™ï¼ˆé€šè¿‡ç»‘å®šè¿æ¥ï¼‰
âœ“ çµæ´»ç®¡ç†
âœ“ æƒé™å˜æ›´ç®€å•
âœ“ è§’è‰²å¯é‡ç”¨
```

**ğŸ¨ æƒé™ç®¡ç†çš„ä¸‰è¦ç´ **

| **è¦ç´ ** | **ä½œç”¨** | **ä¸¾ä¾‹** |
|---------|---------|---------|
| **Subjectï¼ˆä¸»ä½“ï¼‰** | `è°è¦è·å¾—æƒé™` | `ç”¨æˆ·johnã€ServiceAccount app-sa` |
| **Roleï¼ˆè§’è‰²ï¼‰** | `æœ‰ä»€ä¹ˆæƒé™` | `å¯ä»¥è¯»å–Podã€å¯ä»¥åˆ›å»ºService` |
| **Bindingï¼ˆç»‘å®šï¼‰** | `æŠŠä¸»ä½“å’Œè§’è‰²è¿æ¥èµ·æ¥` | `johnè·å¾—pod-readeræƒé™` |

### 1.3 æƒé™ç»‘å®šçš„ä¸¤ç§ç±»å‹


**ğŸ“Š ç±»å‹å¯¹æ¯”ä¸€è§ˆ**

```
æƒé™ç»‘å®šç±»å‹å¯¹æ¯”ï¼š

RoleBinding                   ClusterRoleBinding
     â†“                             â†“
å‘½åç©ºé—´çº§åˆ«ç»‘å®š                å…¨é›†ç¾¤çº§åˆ«ç»‘å®š
     â†“                             â†“
åªåœ¨ç‰¹å®šå‘½åç©ºé—´ç”Ÿæ•ˆ          åœ¨æ•´ä¸ªé›†ç¾¤èŒƒå›´å†…ç”Ÿæ•ˆ
```

| **ç»‘å®šç±»å‹** | **ä½œç”¨èŒƒå›´** | **ä½¿ç”¨åœºæ™¯** | **æƒé™æ•ˆæœ** |
|-------------|-------------|-------------|-------------|
| **RoleBinding** | `å•ä¸ªå‘½åç©ºé—´` | `å¼€å‘å›¢é˜Ÿåªç®¡ç†è‡ªå·±çš„é¡¹ç›®` | `åªèƒ½æ“ä½œæŒ‡å®šå‘½åç©ºé—´çš„èµ„æº` |
| **ClusterRoleBinding** | `æ•´ä¸ªé›†ç¾¤` | `é›†ç¾¤ç®¡ç†å‘˜ã€ç³»ç»Ÿç»„ä»¶` | `å¯ä»¥æ“ä½œå…¨é›†ç¾¤çš„èµ„æº` |

---

## 2. ğŸ­ RoleBindingè§’è‰²ç»‘å®šè¯¦è§£


### 2.1 RoleBindingçš„å·¥ä½œåŸç†


**ğŸ”§ RoleBindingç»“æ„è§£æ**

```
RoleBindingçš„ç»„æˆéƒ¨åˆ†ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 RoleBinding                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   metadata      â”‚   subjects      â”‚  roleRef    â”‚
â”‚   (åŸºæœ¬ä¿¡æ¯)     â”‚   (ä¸»ä½“åˆ—è¡¨)     â”‚  (è§’è‰²å¼•ç”¨)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ name           â”‚â€¢ Userç±»å‹       â”‚â€¢ Roleåç§°   â”‚
â”‚â€¢ namespace      â”‚â€¢ Groupç±»å‹      â”‚â€¢ æƒé™è§„åˆ™   â”‚
â”‚â€¢ labels         â”‚â€¢ ServiceAccount â”‚â€¢ APIç‰ˆæœ¬    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ ç»‘å®šé€»è¾‘æµç¨‹**

```
RoleBindingå·¥ä½œæµç¨‹ï¼š

ç”¨æˆ·å‘èµ·è¯·æ±‚ â”€â”€â†’ K8sæ£€æŸ¥èº«ä»½ â”€â”€â†’ æŸ¥æ‰¾ç›¸å…³RoleBinding â”€â”€â†’ æ£€æŸ¥è§’è‰²æƒé™ â”€â”€â†’ å…è®¸/æ‹’ç»æ“ä½œ
     â”‚               â”‚               â”‚                â”‚              â”‚
  kubectl get pods   johnç”¨æˆ·      john-binding     pod-reader     æ“ä½œæˆåŠŸ
```

### 2.2 åˆ›å»ºRoleBindingçš„å®Œæ•´ç¤ºä¾‹


**ğŸš€ åŸºç¡€RoleBindingåˆ›å»º**

```yaml
# ç¤ºä¾‹ï¼šç»™ç”¨æˆ·johnåˆ†é…podè¯»å–æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: john-pod-reader        # ç»‘å®šåç§°
  namespace: development       # ä½œç”¨å‘½åç©ºé—´
subjects:                      # ä¸»ä½“åˆ—è¡¨
- kind: User                   # ä¸»ä½“ç±»å‹ï¼šç”¨æˆ·
  name: john                   # ç”¨æˆ·å
  apiGroup: rbac.authorization.k8s.io
roleRef:                       # è§’è‰²å¼•ç”¨
  kind: Role                   # è§’è‰²ç±»å‹
  name: pod-reader             # è§’è‰²åç§°
  apiGroup: rbac.authorization.k8s.io
```

> **ğŸ“‹ è¯´æ˜**ï¼šè¿™ä¸ªé…ç½®çš„å«ä¹‰æ˜¯"åœ¨developmentå‘½åç©ºé—´ä¸­ï¼Œç»™ç”¨æˆ·johnç»‘å®špod-readerè§’è‰²çš„æƒé™"

**ğŸ”¨ å‘½ä»¤è¡Œåˆ›å»ºæ–¹å¼**

```bash
# æ–¹æ³•1ï¼šç›´æ¥åˆ›å»ºç»‘å®š
kubectl create rolebinding john-pod-reader \
  --role=pod-reader \
  --user=john \
  --namespace=development

# æ–¹æ³•2ï¼šç»™ServiceAccountåˆ›å»ºç»‘å®š
kubectl create rolebinding app-binding \
  --role=app-role \
  --serviceaccount=development:app-service-account \
  --namespace=development
```

### 2.3 å¤šä¸»ä½“ç»‘å®šç¤ºä¾‹


**ğŸ‘¥ ä¸€ä¸ªç»‘å®šå¤šä¸ªä¸»ä½“**

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: team-dev-binding
  namespace: development
subjects:
# ç”¨æˆ·ç±»å‹
- kind: User
  name: alice
  apiGroup: rbac.authorization.k8s.io
- kind: User
  name: bob
  apiGroup: rbac.authorization.k8s.io
# ç”¨æˆ·ç»„ç±»å‹
- kind: Group
  name: dev-team
  apiGroup: rbac.authorization.k8s.io
# ServiceAccountç±»å‹
- kind: ServiceAccount
  name: dev-app-sa
  namespace: development
roleRef:
  kind: Role
  name: dev-role
  apiGroup: rbac.authorization.k8s.io
```

> **ğŸ’¡ ç†è§£è¦ç‚¹**ï¼šä¸€ä¸ªRoleBindingå¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ªä¸åŒç±»å‹çš„ä¸»ä½“ï¼Œè¿™äº›ä¸»ä½“éƒ½ä¼šè·å¾—ç›¸åŒçš„è§’è‰²æƒé™ã€‚

### 2.4 ç»‘å®šClusterRoleåˆ°å‘½åç©ºé—´


**âš¡ é‡è¦æ¦‚å¿µ**ï¼šRoleBindingä¸ä»…èƒ½ç»‘å®šRoleï¼Œè¿˜èƒ½ç»‘å®šClusterRoleï¼

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: john-admin-binding
  namespace: development        # åªåœ¨è¿™ä¸ªå‘½åç©ºé—´ç”Ÿæ•ˆ
subjects:
- kind: User
  name: john
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole            # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ClusterRole
  name: admin                  # ä½¿ç”¨é›†ç¾¤çº§åˆ«çš„adminæƒé™
  apiGroup: rbac.authorization.k8s.io
```

> **ğŸ¯ å®é™…æ•ˆæœ**ï¼šjohnç”¨æˆ·åœ¨developmentå‘½åç©ºé—´ä¸­æ‹¥æœ‰adminçº§åˆ«çš„æƒé™ï¼Œä½†åœ¨å…¶ä»–å‘½åç©ºé—´ä¸­æ²¡æœ‰ä»»ä½•æƒé™ã€‚

**ğŸ” ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

```
è®¾è®¡ç†å¿µè§£é‡Šï¼š

ClusterRoleå®šä¹‰ â”€â”€â”€â”€â†’ é›†ç¾¤çº§åˆ«çš„æƒé™æ¨¡æ¿
      â†“
RoleBindingä½¿ç”¨ â”€â”€â”€â”€â†’ å°†æƒé™é™åˆ¶åœ¨ç‰¹å®šå‘½åç©ºé—´
      â†“
å®é™…æ•ˆæœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ—¢åˆ©ç”¨äº†é€šç”¨æƒé™æ¨¡æ¿ï¼Œåˆé™åˆ¶äº†ä½œç”¨èŒƒå›´
```

---

## 3. ğŸŒ ClusterRoleBindingé›†ç¾¤è§’è‰²ç»‘å®š


### 3.1 ClusterRoleBindingæ¦‚å¿µç†è§£


**ğŸ¢ å…¨å…¬å¸çº§åˆ«çš„æƒé™**

> å¦‚æœè¯´RoleBindingåƒæ˜¯ç»™æŸä¸ªéƒ¨é—¨åˆ†é…æƒé™ï¼Œé‚£ClusterRoleBindingå°±åƒæ˜¯ç»™æ•´ä¸ªå…¬å¸åˆ†é…æƒé™ã€‚è·å¾—è¿™ç§ç»‘å®šçš„ç”¨æˆ·å¯ä»¥åœ¨å…¬å¸ä»»ä½•åœ°æ–¹è¡Œä½¿æƒé™ã€‚

**ğŸ”¸ ClusterRoleBindingç‰¹ç‚¹**

```
ClusterRoleBindingç‰¹æ€§ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ•´ä¸ªKubernetesé›†ç¾¤              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ namespace-a â”‚ namespace-b â”‚ namespace-c â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœ‰æƒé™æ“ä½œ   â”‚ æœ‰æƒé™æ“ä½œ   â”‚ æœ‰æƒé™æ“ä½œ   â”‚
â”‚ æ‰€æœ‰èµ„æº    â”‚ æ‰€æœ‰èµ„æº    â”‚ æ‰€æœ‰èµ„æº    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| **ç‰¹æ€§** | **è¯´æ˜** | **ä½¿ç”¨åœºæ™¯** |
|---------|---------|-------------|
| **å…¨é›†ç¾¤èŒƒå›´** | `è·¨æ‰€æœ‰å‘½åç©ºé—´ç”Ÿæ•ˆ` | `é›†ç¾¤ç®¡ç†å‘˜` |
| **æ— å‘½åç©ºé—´é™åˆ¶** | `ä¸å—namespaceçº¦æŸ` | `ç›‘æ§ç³»ç»Ÿ` |
| **æƒé™çº§åˆ«é«˜** | `é€šå¸¸ç”¨äºå…³é”®æ“ä½œ` | `CI/CDæµæ°´çº¿` |

### 3.2 ClusterRoleBindingåˆ›å»ºç¤ºä¾‹


**ğŸ‘¨â€ğŸ’¼ é›†ç¾¤ç®¡ç†å‘˜ç»‘å®š**

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-admin-binding
subjects:
- kind: User
  name: admin-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
```

**ğŸ¤– ç³»ç»Ÿç»„ä»¶ç»‘å®š**

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: monitoring-binding
subjects:
- kind: ServiceAccount
  name: prometheus-sa
  namespace: monitoring
roleRef:
  kind: ClusterRole
  name: prometheus-role
  apiGroup: rbac.authorization.k8s.io
```

### 3.3 RoleBinding vs ClusterRoleBinding å®æˆ˜å¯¹æ¯”


**ğŸ“Š æƒé™èŒƒå›´å¯¹æ¯”å®éªŒ**

å‡è®¾æœ‰ä»¥ä¸‹åœºæ™¯ï¼šç”¨æˆ·éœ€è¦åœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­ç®¡ç†Pod

**æ–¹æ¡ˆ1ï¼šä½¿ç”¨RoleBindingï¼ˆéœ€è¦å¤šä¸ªï¼‰**

```bash
# éœ€è¦åœ¨æ¯ä¸ªå‘½åç©ºé—´åˆ›å»ºç»‘å®š
kubectl create rolebinding pod-manager-dev \
  --clusterrole=pod-manager \
  --user=john \
  --namespace=development

kubectl create rolebinding pod-manager-test \
  --clusterrole=pod-manager \
  --user=john \
  --namespace=testing

kubectl create rolebinding pod-manager-prod \
  --clusterrole=pod-manager \
  --user=john \
  --namespace=production
```

**æ–¹æ¡ˆ2ï¼šä½¿ç”¨ClusterRoleBindingï¼ˆä¸€ä¸ªæå®šï¼‰**

```bash
# ä¸€æ¬¡æ€§ç»™å…¨é›†ç¾¤æƒé™
kubectl create clusterrolebinding pod-manager-global \
  --clusterrole=pod-manager \
  --user=john
```

**ğŸ¯ é€‰æ‹©å»ºè®®**

| **åœºæ™¯** | **æ¨èæ–¹æ¡ˆ** | **ç†ç”±** |
|---------|-------------|---------|
| **å¼€å‘å›¢é˜Ÿç®¡ç†é¡¹ç›®** | `RoleBinding` | `æƒé™æœ€å°åŒ–ï¼Œå®‰å…¨æ€§å¥½` |
| **è¿ç»´ç®¡ç†å¤šç¯å¢ƒ** | `ClusterRoleBinding` | `ç®¡ç†ä¾¿åˆ©ï¼Œé¿å…é‡å¤é…ç½®` |
| **ç›‘æ§ç³»ç»Ÿéƒ¨ç½²** | `ClusterRoleBinding` | `éœ€è¦è®¿é—®æ‰€æœ‰å‘½åç©ºé—´çš„èµ„æº` |

---

## 4. ğŸ‘¤ ä¸»ä½“Subjectæ·±åº¦ç†è§£


### 4.1 ä¸‰ç§ä¸»ä½“ç±»å‹è¯¦è§£


**ğŸ” ä¸»ä½“ç±»å‹å¯¹æ¯”**

```
K8sä¸­çš„ä¸»ä½“ç±»å‹ï¼š

User (ç”¨æˆ·)                Group (ç”¨æˆ·ç»„)           ServiceAccount (æœåŠ¡è´¦å·)
    â†“                         â†“                         â†“
çœŸå®çš„äººå‘˜è´¦å·              ä¸€ç»„ç”¨æˆ·çš„é›†åˆ              åº”ç”¨ç¨‹åºè´¦å·
    â†“                         â†“                         â†“
ç”±å¤–éƒ¨ç³»ç»Ÿç®¡ç†               ä¾¿äºæ‰¹é‡ç®¡ç†                K8så†…éƒ¨ç®¡ç†
```

### 4.2 Userä¸»ä½“ç±»å‹


**ğŸ‘¨â€ğŸ’» ç”¨æˆ·ä¸»ä½“ç‰¹ç‚¹**

```yaml
# Userä¸»ä½“ç¤ºä¾‹
subjects:
- kind: User
  name: "john@company.com"      # é€šå¸¸æ˜¯é‚®ç®±æ ¼å¼
  apiGroup: rbac.authorization.k8s.io
```

> **ğŸ’¡ é‡è¦è¯´æ˜**ï¼šK8sæœ¬èº«ä¸ç®¡ç†ç”¨æˆ·è´¦å·ï¼Œç”¨æˆ·ä¿¡æ¯é€šå¸¸æ¥è‡ªå¤–éƒ¨è®¤è¯ç³»ç»Ÿï¼ˆå¦‚LDAPã€OAuthç­‰ï¼‰

**ğŸ”§ Userå¸¸è§ä½¿ç”¨åœºæ™¯**

| **åœºæ™¯** | **ç”¨æˆ·æ ‡è¯†** | **è®¤è¯æ–¹å¼** |
|---------|-------------|-------------|
| **å¼€å‘äººå‘˜** | `john@company.com` | `OIDCã€LDAP` |
| **è¿ç»´äººå‘˜** | `ops-team-lead` | `è¯ä¹¦è®¤è¯` |
| **ä¸´æ—¶è®¿é—®** | `contractor-001` | `Tokenè®¤è¯` |

### 4.3 Groupä¸»ä½“ç±»å‹


**ğŸ‘¥ ç”¨æˆ·ç»„ç®¡ç†**

```yaml
# Groupä¸»ä½“ç¤ºä¾‹
subjects:
- kind: Group
  name: "system:authenticated"   # æ‰€æœ‰è®¤è¯ç”¨æˆ·ç»„
  apiGroup: rbac.authorization.k8s.io
- kind: Group
  name: "dev-team"              # è‡ªå®šä¹‰å¼€å‘å›¢é˜Ÿç»„
  apiGroup: rbac.authorization.k8s.io
```

**ğŸ¯ å¸¸ç”¨ç³»ç»Ÿç»„**

| **ç³»ç»Ÿç»„** | **å«ä¹‰** | **ç”¨é€”** |
|-----------|---------|---------|
| `system:authenticated` | `æ‰€æœ‰å·²è®¤è¯ç”¨æˆ·` | `åŸºç¡€è®¿é—®æƒé™` |
| `system:unauthenticated` | `æœªè®¤è¯ç”¨æˆ·` | `å…¬å¼€è®¿é—®èµ„æº` |
| `system:serviceaccounts` | `æ‰€æœ‰ServiceAccount` | `åº”ç”¨ç¨‹åºæƒé™ç®¡ç†` |

### 4.4 ServiceAccountä¸»ä½“ç±»å‹


**ğŸ¤– æœåŠ¡è´¦å·è¯¦è§£**

> ServiceAccountæ˜¯K8sä¸“é—¨ä¸ºPodä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºæä¾›çš„èº«ä»½æ ‡è¯†ï¼Œå°±åƒç»™æ¯ä¸ªåº”ç”¨ç¨‹åºå‘äº†ä¸€å¼ "å‘˜å·¥å¡"ã€‚

```yaml
# ServiceAccountä¸»ä½“ç¤ºä¾‹
subjects:
- kind: ServiceAccount
  name: "web-app-sa"
  namespace: "production"       # å¿…é¡»æŒ‡å®šå‘½åç©ºé—´
```

**ğŸ“‹ ServiceAccountåˆ›å»ºä¸ä½¿ç”¨**

```bash
# åˆ›å»ºServiceAccount
kubectl create serviceaccount web-app-sa -n production

# æŸ¥çœ‹ServiceAccount
kubectl get serviceaccounts -n production

# Podä¸­ä½¿ç”¨ServiceAccount
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: web-app
  namespace: production
spec:
  serviceAccountName: web-app-sa    # æŒ‡å®šä½¿ç”¨çš„ServiceAccount
  containers:
  - name: app
    image: nginx
```

### 4.5 ä¸»ä½“é€‰æ‹©æœ€ä½³å®è·µ


**ğŸ† é€‰æ‹©å»ºè®®**

```
ä¸»ä½“ç±»å‹é€‰æ‹©æŒ‡å—ï¼š

äººå‘˜è®¿é—® â”€â”€â”€â”€â”€â”€â”€â”€â†’ Userç±»å‹
  â”‚
  â”œâ”€ ä¸ªäººå¼€å‘è€… â†’ User
  â”œâ”€ å›¢é˜Ÿç®¡ç† â”€â”€â†’ Group
  â””â”€ å¤–éƒ¨é›†æˆ â”€â”€â†’ User + è¯ä¹¦

åº”ç”¨è®¿é—® â”€â”€â”€â”€â”€â”€â”€â”€â†’ ServiceAccountç±»å‹  
  â”‚
  â”œâ”€ Podåº”ç”¨ â”€â”€â”€â†’ ServiceAccount
  â”œâ”€ ç³»ç»Ÿç»„ä»¶ â”€â”€â†’ ServiceAccount
  â””â”€ å¤–éƒ¨æœåŠ¡ â”€â”€â†’ ServiceAccount
```

---

## 5. ğŸ› ï¸ æƒé™ç»‘å®šå®æˆ˜æ“ä½œ


### 5.1 å®Œæ•´çš„æƒé™ç»‘å®šå®æˆ˜æµç¨‹


**ğŸ¯ å®æˆ˜ç›®æ ‡**ï¼šä¸ºå¼€å‘å›¢é˜Ÿé…ç½®åˆç†çš„æƒé™ä½“ç³»

**æ­¥éª¤1ï¼šåˆ›å»ºå‘½åç©ºé—´å’ŒåŸºç¡€èµ„æº**

```bash
# åˆ›å»ºå¼€å‘ç¯å¢ƒå‘½åç©ºé—´
kubectl create namespace dev-team

# åˆ›å»ºServiceAccount
kubectl create serviceaccount dev-app-sa -n dev-team
```

**æ­¥éª¤2ï¼šå®šä¹‰æƒé™è§’è‰²**

```yaml
# dev-role.yaml - å¼€å‘å›¢é˜Ÿè§’è‰²æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev-team
  name: dev-team-role
rules:
- apiGroups: [""]
  resources: ["pods", "services", "configmaps"]
  verbs: ["get", "list", "create", "update", "delete"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["get", "list", "create", "update", "delete"]
```

**æ­¥éª¤3ï¼šåˆ›å»ºæƒé™ç»‘å®š**

```yaml
# dev-binding.yaml - å¼€å‘å›¢é˜Ÿæƒé™ç»‘å®š
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: dev-team-binding
  namespace: dev-team
subjects:
# å¼€å‘äººå‘˜
- kind: User
  name: alice
  apiGroup: rbac.authorization.k8s.io
- kind: User
  name: bob
  apiGroup: rbac.authorization.k8s.io
# åº”ç”¨æœåŠ¡è´¦å·
- kind: ServiceAccount
  name: dev-app-sa
  namespace: dev-team
roleRef:
  kind: Role
  name: dev-team-role
  apiGroup: rbac.authorization.k8s.io
```

**æ­¥éª¤4ï¼šåº”ç”¨å’ŒéªŒè¯**

```bash
# åº”ç”¨é…ç½®
kubectl apply -f dev-role.yaml
kubectl apply -f dev-binding.yaml

# éªŒè¯ç»‘å®š
kubectl get rolebindings -n dev-team
kubectl describe rolebinding dev-team-binding -n dev-team
```

### 5.2 æƒé™ç»‘å®šçš„æŸ¥çœ‹å’Œç®¡ç†


**ğŸ” æŸ¥çœ‹æƒé™ç»‘å®š**

```bash
# æŸ¥çœ‹æ‰€æœ‰RoleBinding
kubectl get rolebindings --all-namespaces

# æŸ¥çœ‹ç‰¹å®šå‘½åç©ºé—´çš„RoleBinding
kubectl get rolebindings -n dev-team

# æŸ¥çœ‹ClusterRoleBinding
kubectl get clusterrolebindings

# è¯¦ç»†ä¿¡æ¯æŸ¥çœ‹
kubectl describe rolebinding dev-team-binding -n dev-team
```

**âœï¸ ä¿®æ”¹æƒé™ç»‘å®š**

```bash
# æ–¹æ³•1ï¼šç¼–è¾‘ç°æœ‰ç»‘å®š
kubectl edit rolebinding dev-team-binding -n dev-team

# æ–¹æ³•2ï¼šåˆ é™¤åé‡æ–°åˆ›å»º
kubectl delete rolebinding dev-team-binding -n dev-team
kubectl create rolebinding dev-team-binding \
  --role=dev-team-role \
  --user=alice \
  --user=bob \
  --serviceaccount=dev-team:dev-app-sa \
  --namespace=dev-team
```

### 5.3 æƒé™æµ‹è¯•å’ŒéªŒè¯


**ğŸ§ª æƒé™æµ‹è¯•æ–¹æ³•**

```bash
# ä½¿ç”¨kubectl auth can-i æµ‹è¯•æƒé™
kubectl auth can-i get pods --as=alice -n dev-team
kubectl auth can-i create services --as=bob -n dev-team
kubectl auth can-i delete deployments --as=system:serviceaccount:dev-team:dev-app-sa -n dev-team

# æµ‹è¯•ä¸åŒå‘½åç©ºé—´çš„æƒé™
kubectl auth can-i get pods --as=alice -n production  # åº”è¯¥è¿”å› no
```

**ğŸ“Š æƒé™éªŒè¯ç»“æœè§£è¯»**

| **å‘½ä»¤ç»“æœ** | **å«ä¹‰** | **è¯´æ˜** |
|-------------|---------|---------|
| `yes` | `æœ‰æƒé™æ‰§è¡Œè¯¥æ“ä½œ` | `ç»‘å®šé…ç½®æ­£ç¡®` |
| `no` | `æ²¡æœ‰æƒé™æ‰§è¡Œè¯¥æ“ä½œ` | `ç¬¦åˆæƒé™æœ€å°åŒ–åŸåˆ™` |
| `unknown` | `æ— æ³•ç¡®å®šæƒé™` | `å¯èƒ½æ˜¯é…ç½®é”™è¯¯` |

### 5.4 å¸¸è§é—®é¢˜æ’æŸ¥


**â“ æƒé™ä¸ç”Ÿæ•ˆçš„æ’æŸ¥æ­¥éª¤**

```
æƒé™é—®é¢˜æ’æŸ¥æµç¨‹ï¼š

æƒé™ä¸ç”Ÿæ•ˆ â”€â”€â†’ æ£€æŸ¥Bindingæ˜¯å¦å­˜åœ¨ â”€â”€â†’ æ£€æŸ¥Roleå®šä¹‰ â”€â”€â†’ æ£€æŸ¥ä¸»ä½“ä¿¡æ¯ â”€â”€â†’ æ£€æŸ¥å‘½åç©ºé—´
     â”‚              â”‚                 â”‚            â”‚             â”‚
   æŠ¥é”™ä¿¡æ¯         kubectl get        kubectl get   ç”¨æˆ·å/SAå   namespaceåŒ¹é…
                   rolebinding         role
```

**ğŸ”§ å¸¸è§é”™è¯¯ä¸è§£å†³**

| **é”™è¯¯ç°è±¡** | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ³•** |
|-------------|-------------|-------------|
| `æƒé™æ‹’ç»` | `æ²¡æœ‰å¯¹åº”çš„RoleBinding` | `åˆ›å»ºæ­£ç¡®çš„æƒé™ç»‘å®š` |
| `æ‰¾ä¸åˆ°è§’è‰²` | `Roleä¸å­˜åœ¨æˆ–åç§°é”™è¯¯` | `æ£€æŸ¥Roleå®šä¹‰` |
| `ä¸»ä½“è®¤è¯å¤±è´¥` | `ç”¨æˆ·åæˆ–SAåç§°é”™è¯¯` | `ç¡®è®¤ä¸»ä½“ä¿¡æ¯æ­£ç¡®` |
| `è·¨å‘½åç©ºé—´æƒé™é—®é¢˜` | `RoleBindingä½œç”¨èŒƒå›´é™åˆ¶` | `ä½¿ç”¨ClusterRoleBinding` |

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æƒé™ç»‘å®šæœ¬è´¨ï¼šè¿æ¥ä¸»ä½“(who)å’Œè§’è‰²(what)çš„æ¡¥æ¢
ğŸ”¸ RoleBindingï¼šå‘½åç©ºé—´çº§åˆ«çš„æƒé™ç»‘å®šï¼Œä½œç”¨èŒƒå›´å—é™
ğŸ”¸ ClusterRoleBindingï¼šé›†ç¾¤çº§åˆ«çš„æƒé™ç»‘å®šï¼Œå…¨é›†ç¾¤ç”Ÿæ•ˆ
ğŸ”¸ ä¸»ä½“ç±»å‹ï¼šUser(äººå‘˜)ã€Group(ç”¨æˆ·ç»„)ã€ServiceAccount(åº”ç”¨)
ğŸ”¸ ç»‘å®šå…³ç³»ï¼šä¸€ä¸ªç»‘å®šå¯ä»¥åŒ…å«å¤šä¸ªä¸»ä½“ï¼Œæ‰€æœ‰ä¸»ä½“è·å¾—ç›¸åŒæƒé™
ğŸ”¸ æƒé™ç»§æ‰¿ï¼šRoleBindingå¯ä»¥ç»‘å®šClusterRoleï¼Œä½†æƒé™èŒƒå›´ä»å—å‘½åç©ºé—´é™åˆ¶
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æƒé™ç»‘å®šçš„è®¾è®¡å“²å­¦**
```
åˆ†ç¦»å¼è®¾è®¡çš„ä¼˜åŠ¿ï¼š
è§’è‰²å®šä¹‰ â†â”€â”€â”€â”€â”€â†’ æƒé™è§„åˆ™ï¼ˆå¯é‡ç”¨ï¼‰
ç»‘å®šå…³ç³» â†â”€â”€â”€â”€â”€â†’ çµæ´»ç»„åˆï¼ˆæ˜“ç®¡ç†ï¼‰  
ä¸»ä½“èº«ä»½ â†â”€â”€â”€â”€â”€â†’ èº«ä»½è®¤è¯ï¼ˆå®‰å…¨å¯æ§ï¼‰
```

**ğŸ”¹ å‘½åç©ºé—´æƒé™è¾¹ç•Œ**
```
RoleBindingä½œç”¨æœºåˆ¶ï¼š
å³ä½¿ç»‘å®šClusterRoleï¼Œæƒé™ä»ç„¶åªåœ¨æŒ‡å®šå‘½åç©ºé—´ç”Ÿæ•ˆ
è¿™æ˜¯K8så¤šç§Ÿæˆ·å®‰å…¨çš„é‡è¦ä¿éšœæœºåˆ¶
```

**ğŸ”¹ ä¸»ä½“ç±»å‹é€‰æ‹©åŸåˆ™**
```
äººå‘˜è®¿é—® â†’ User/Groupï¼ˆå¤–éƒ¨è®¤è¯ï¼‰
åº”ç”¨è®¿é—® â†’ ServiceAccountï¼ˆå†…éƒ¨ç®¡ç†ï¼‰
ç³»ç»Ÿç»„ä»¶ â†’ ServiceAccountï¼ˆå®‰å…¨éš”ç¦»ï¼‰
```

### 6.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ’¼ ä¼ä¸šçº§æƒé™ç®¡ç†å®è·µ**

| **åœºæ™¯** | **ç»‘å®šç­–ç•¥** | **æƒé™èŒƒå›´** | **ç®¡ç†å¤æ‚åº¦** |
|---------|-------------|-------------|---------------|
| **å¼€å‘å›¢é˜Ÿ** | `RoleBinding + Role` | `é¡¹ç›®å‘½åç©ºé—´` | `ä½` |
| **è¿ç»´å›¢é˜Ÿ** | `ClusterRoleBinding + ClusterRole` | `å…¨é›†ç¾¤` | `ä¸­` |
| **åº”ç”¨ç¨‹åº** | `RoleBinding + ServiceAccount` | `åº”ç”¨å‘½åç©ºé—´` | `ä½` |
| **ç›‘æ§ç³»ç»Ÿ** | `ClusterRoleBinding + ServiceAccount` | `å…¨é›†ç¾¤åªè¯»` | `ä¸­` |

**ğŸ¯ æœ€ä½³å®è·µå»ºè®®**

```
æƒé™è®¾è®¡åŸåˆ™ï¼š

æœ€å°æƒé™åŸåˆ™ â”€â”€â†’ åªç»™å¿…éœ€çš„æƒé™ï¼Œä¸å¤šç»™
å‘½åç©ºé—´éš”ç¦» â”€â”€â†’ ä¼˜å…ˆä½¿ç”¨RoleBindingé™åˆ¶èŒƒå›´  
å®šæœŸå®¡æŸ¥æƒé™ â”€â”€â†’ åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç»‘å®š
æ ‡å‡†åŒ–ç®¡ç† â”€â”€â†’ åˆ¶å®šç»Ÿä¸€çš„æƒé™åˆ†é…è§„èŒƒ
```

**ğŸ”§ è¿ç»´ç®¡ç†å»ºè®®**

```
æ—¥å¸¸ç®¡ç†è¦ç‚¹ï¼š

æƒé™ç”³è¯·æµç¨‹ â”€â”€â†’ æ ‡å‡†åŒ–çš„æƒé™ç”³è¯·å’Œå®¡æ‰¹æµç¨‹
æƒé™å˜æ›´è®°å½• â”€â”€â†’ æ‰€æœ‰æƒé™å˜æ›´éƒ½è¦æœ‰è®°å½•å’Œå®¡è®¡
å®šæœŸæƒé™æ¸…ç† â”€â”€â†’ æ¸…ç†ç¦»èŒå‘˜å·¥å’ŒåºŸå¼ƒåº”ç”¨çš„æƒé™
æƒé™æµ‹è¯•éªŒè¯ â”€â”€â†’ æ¯æ¬¡æƒé™å˜æ›´åéƒ½è¦æµ‹è¯•éªŒè¯
```

### 6.4 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸ“š æ·±å…¥å­¦ä¹ è·¯å¾„**

```
æƒé™ç»‘å®šè¿›é˜¶ï¼š

åŸºç¡€ç»‘å®šæ“ä½œ â”€â”€â†’ é«˜çº§æƒé™ç­–ç•¥ â”€â”€â†’ ä¼ä¸šçº§æƒé™ç®¡ç†
     â”‚              â”‚              â”‚
  æŒæ¡åŸºæœ¬è¯­æ³•    ç­–ç•¥ç»§æ‰¿æœºåˆ¶    é›†æˆå¤–éƒ¨è®¤è¯ç³»ç»Ÿ
  ç†è§£æƒé™èŒƒå›´    åŠ¨æ€æƒé™åˆ†é…    æƒé™å®¡è®¡å’Œç›‘æ§
```

**ğŸš€ å®æˆ˜æŠ€èƒ½æå‡**

- **æƒé™ç­–ç•¥è®¾è®¡**ï¼šä¸ºä¸åŒè§„æ¨¡çš„å›¢é˜Ÿè®¾è®¡åˆç†çš„æƒé™æ¶æ„
- **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šä½¿ç”¨è„šæœ¬æˆ–å·¥å…·æ‰¹é‡ç®¡ç†æƒé™ç»‘å®š
- **å®‰å…¨å®¡è®¡**ï¼šå®šæœŸå®¡æŸ¥å’Œä¼˜åŒ–æƒé™é…ç½®
- **æ•…éšœæ’æŸ¥**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³æƒé™ç›¸å…³é—®é¢˜

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æƒé™ç»‘å®šè¿ä¸»ä½“ï¼Œè§’è‰²æƒé™è¦åˆ†ç¦»
Roleç»‘å®šç®¡å‘½åç©ºé—´ï¼ŒClusterç»‘å®šç®¡å…¨å±€
User Group SAä¸‰ä¸»ä½“ï¼ŒæŒ‰éœ€é€‰æ‹©æœ€åˆé€‚
æœ€å°æƒé™ä¿å®‰å…¨ï¼Œå®šæœŸå®¡æŸ¥é™¤éšæ‚£
```