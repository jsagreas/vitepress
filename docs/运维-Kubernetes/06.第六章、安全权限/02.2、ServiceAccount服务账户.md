---
title: 2ã€ServiceAccountæœåŠ¡è´¦æˆ·
---
## ğŸ“š ç›®å½•

1. [ServiceAccountåŸºæœ¬æ¦‚å¿µ](#1-ServiceAccountåŸºæœ¬æ¦‚å¿µ)
2. [é»˜è®¤æœåŠ¡è´¦æˆ·è¯¦è§£](#2-é»˜è®¤æœåŠ¡è´¦æˆ·è¯¦è§£)
3. [è‡ªå®šä¹‰æœåŠ¡è´¦æˆ·ç®¡ç†](#3-è‡ªå®šä¹‰æœåŠ¡è´¦æˆ·ç®¡ç†)
4. [Tokenä»¤ç‰Œæœºåˆ¶](#4-Tokenä»¤ç‰Œæœºåˆ¶)
5. [æœåŠ¡è´¦æˆ·æƒé™ç»‘å®š](#5-æœåŠ¡è´¦æˆ·æƒé™ç»‘å®š)
6. [å®æˆ˜æ“ä½œæŒ‡å—](#6-å®æˆ˜æ“ä½œæŒ‡å—)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ ServiceAccountåŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ServiceAccount


**é€šä¿—ç†è§£**ï¼šServiceAccountå°±åƒæ˜¯ç»™Podï¼ˆå®¹å™¨ï¼‰åŠçš„ä¸€å¼ "èº«ä»½è¯"

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
äººç±»åŠäº‹éœ€è¦èº«ä»½è¯ â†â†’ Podè®¿é—®K8séœ€è¦ServiceAccount
é“¶è¡Œå¡æœ‰ä¸åŒæƒé™    â†â†’ ServiceAccountæœ‰ä¸åŒæƒé™
å…¬å¸å‘˜å·¥è¯è¿›å…¥å¤§æ¥¼  â†â†’ Podé€šè¿‡SAè®¿é—®é›†ç¾¤èµ„æº
```

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
ServiceAccountï¼ˆç®€ç§°SAï¼‰ï¼š
â€¢ ä½œç”¨ï¼šä¸ºPodæä¾›èº«ä»½æ ‡è¯†çš„è´¦æˆ·ç³»ç»Ÿ
â€¢ æœ¬è´¨ï¼šK8sé›†ç¾¤å†…éƒ¨çš„ç”¨æˆ·è®¤è¯æœºåˆ¶
â€¢ ç›®æ ‡ï¼šè®©Podèƒ½å¤Ÿå®‰å…¨åœ°è®¿é—®é›†ç¾¤å†…çš„èµ„æº
â€¢ èŒƒå›´ï¼šå‘½åç©ºé—´çº§åˆ«çš„èµ„æºå¯¹è±¡
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ServiceAccount


**ğŸ¤” æ²¡æœ‰SAä¼šæ€æ ·ï¼Ÿ**
```
é—®é¢˜åœºæ™¯ï¼š
Podè¦è¯»å–ConfigMap â†’ è¢«æ‹’ç»ï¼š"ä½ æ˜¯è°ï¼Ÿ"
Podè¦è°ƒç”¨å…¶ä»–Pod â†’ è¢«æ‹’ç»ï¼š"æ²¡æƒé™ï¼"
Podè¦è®¿é—®API Server â†’ è¢«æ‹’ç»ï¼š"èº«ä»½æœªçŸ¥ï¼"

å°±åƒæ²¡å¸¦èº«ä»½è¯çš„äººæ— æ³•åŠç†ä»»ä½•ä¸šåŠ¡ä¸€æ ·
```

**ğŸ’¡ SAè§£å†³çš„æ ¸å¿ƒé—®é¢˜**
- **èº«ä»½è®¤è¯**ï¼šè¯æ˜Podçš„èº«ä»½
- **æƒé™æ§åˆ¶**ï¼šé™åˆ¶Podçš„è®¿é—®èŒƒå›´
- **å®‰å…¨éš”ç¦»**ï¼šä¸åŒåº”ç”¨ä½¿ç”¨ä¸åŒè´¦æˆ·
- **å®¡è®¡è¿½è¸ª**ï¼šè®°å½•è°åšäº†ä»€ä¹ˆæ“ä½œ

### 1.3 ServiceAccountæ¶æ„å›¾ç¤º


```
K8sé›†ç¾¤å®‰å…¨æ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 K8sé›†ç¾¤                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Pod    â”‚â”€â”€â”€â”€â†’ â”‚   API Server     â”‚     â”‚
â”‚  â”‚          â”‚ è¯·æ±‚ â”‚                  â”‚     â”‚
â”‚  â”‚ é™„å¸¦SA   â”‚      â”‚ éªŒè¯èº«ä»½+æƒé™    â”‚     â”‚
â”‚  â”‚ Token    â”‚      â”‚                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â”‚                      â”‚              â”‚
â”‚       â†“                      â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ServiceAccâ”‚      â”‚      RBAC        â”‚     â”‚
â”‚  â”‚   ount   â”‚â”€â”€â”€â”€â†’ â”‚   æƒé™ç³»ç»Ÿ       â”‚     â”‚
â”‚  â”‚          â”‚      â”‚                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”§ é»˜è®¤æœåŠ¡è´¦æˆ·è¯¦è§£


### 2.1 é»˜è®¤ServiceAccountæœºåˆ¶


**ğŸ¯ K8sçš„è´´å¿ƒè®¾è®¡**ï¼šæ¯ä¸ªå‘½åç©ºé—´éƒ½æœ‰ä¸€ä¸ª`default` ServiceAccount

```bash
# æŸ¥çœ‹é»˜è®¤æœåŠ¡è´¦æˆ·
kubectl get serviceaccount
# è¾“å‡ºç¤ºä¾‹ï¼š
# NAME      SECRETS   AGE
# default   1         30d
```

**ğŸ’¡ é»˜è®¤SAçš„ç‰¹ç‚¹**
```
è‡ªåŠ¨åˆ›å»ºï¼šæ¯ä¸ªnamespaceåˆ›å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆ
è‡ªåŠ¨æŒ‚è½½ï¼šPodæ²¡æŒ‡å®šSAæ—¶è‡ªåŠ¨ä½¿ç”¨default
åŸºæœ¬æƒé™ï¼šåªæœ‰æœ€åŸºç¡€çš„é›†ç¾¤è®¿é—®æƒé™
å®‰å…¨è€ƒè™‘ï¼šæƒé™æœ‰é™ï¼Œé¿å…è¿‡åº¦æˆæƒ
```

### 2.2 é»˜è®¤SAçš„å·¥ä½œæµç¨‹


```
Podå¯åŠ¨æµç¨‹ï¼š
1. åˆ›å»ºPod
   â”‚
   â”œâ”€ æœªæŒ‡å®šSA â”€â†’ è‡ªåŠ¨ä½¿ç”¨default SA
   â”‚
   â”œâ”€ æŒ‡å®šäº†SA  â”€â†’ ä½¿ç”¨æŒ‡å®šçš„SA
   â”‚
   â””â”€ æŒ‚è½½Token â”€â†’ è‡ªåŠ¨æŒ‚è½½åˆ°/var/run/secrets/

TokenæŒ‚è½½ä½ç½®ï¼š
/var/run/secrets/kubernetes.io/serviceaccount/
â”œâ”€â”€ ca.crt      â† é›†ç¾¤è¯ä¹¦
â”œâ”€â”€ namespace   â† å‘½åç©ºé—´åç§°
â””â”€â”€ token       â† è®¿é—®ä»¤ç‰Œ
```

### 2.3 é»˜è®¤SAçš„å±€é™æ€§


**âš ï¸ é»˜è®¤SAçš„é—®é¢˜**
```
æƒé™æœ‰é™ï¼š
â€¢ åªèƒ½è¿›è¡ŒåŸºç¡€çš„é›†ç¾¤å‘ç°
â€¢ æ— æ³•è¯»å–å¤§å¤šæ•°K8sèµ„æº
â€¢ ä¸èƒ½ä¿®æ”¹é›†ç¾¤çŠ¶æ€

å®‰å…¨é£é™©ï¼š
â€¢ æ‰€æœ‰Podå…±äº«åŒä¸€ä¸ªè´¦æˆ·
â€¢ æ— æ³•åšç»†ç²’åº¦æƒé™æ§åˆ¶
â€¢ éš¾ä»¥è¿›è¡Œå®‰å…¨å®¡è®¡

å®é™…å½±å“ï¼š
â€¢ åº”ç”¨æ— æ³•è·å–ConfigMap
â€¢ æ— æ³•è°ƒç”¨K8s API
â€¢ ç›‘æ§ç»„ä»¶æ— æ³•æ”¶é›†ä¿¡æ¯
```

---

## 3. ğŸ› ï¸ è‡ªå®šä¹‰æœåŠ¡è´¦æˆ·ç®¡ç†


### 3.1 åˆ›å»ºè‡ªå®šä¹‰ServiceAccount


**ğŸ“ åŸºæœ¬åˆ›å»ºæ–¹æ³•**

```yaml
# serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-app-sa          # SAåç§°
  namespace: default       # æ‰€å±å‘½åç©ºé—´
  labels:
    app: my-application
    version: v1.0
```

```bash
# å‘½ä»¤è¡Œå¿«é€Ÿåˆ›å»º
kubectl create serviceaccount my-app-sa -n default

# åº”ç”¨yamlæ–‡ä»¶
kubectl apply -f serviceaccount.yaml
```

### 3.2 SAçš„è¯¦ç»†é…ç½®é€‰é¡¹


**ğŸ”§ é«˜çº§é…ç½®ç¤ºä¾‹**

```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: advanced-sa
  namespace: production
  annotations:
    # ç¦ç”¨è‡ªåŠ¨æŒ‚è½½token
    kubernetes.io/enforce-mountable-secrets: "false"
    # è‡ªå®šä¹‰æè¿°
    description: "ç”Ÿäº§ç¯å¢ƒä¸“ç”¨æœåŠ¡è´¦æˆ·"
  labels:
    environment: production
    team: backend
# å¯é€‰ï¼šæŒ‡å®šImage Pull Secrets
imagePullSecrets:
- name: my-registry-secret
# å¯é€‰ï¼šæŒ‡å®šå¯æŒ‚è½½çš„Secrets
secrets:
- name: custom-secret
```

**ğŸ’¡ é…ç½®é¡¹è¯¦è§£**
```
metadata.annotationsï¼š
â€¢ kubernetes.io/enforce-mountable-secrets
  æ§åˆ¶æ˜¯å¦è‡ªåŠ¨æŒ‚è½½token

imagePullSecretsï¼š
â€¢ æŒ‡å®šæ‹‰å–ç§æœ‰é•œåƒæ—¶ä½¿ç”¨çš„è®¤è¯ä¿¡æ¯
â€¢ Podä½¿ç”¨æ­¤SAæ—¶è‡ªåŠ¨è·å¾—æ‹‰å–æƒé™

secretsï¼š
â€¢ æ‰‹åŠ¨æŒ‡å®šSAå¯ä»¥ä½¿ç”¨çš„Secrets
â€¢ å¢å¼ºå®‰å…¨æ€§ï¼Œé™åˆ¶è®¿é—®èŒƒå›´
```

### 3.3 ä¸ºPodæŒ‡å®šServiceAccount


**ğŸ¯ ä¸¤ç§æŒ‡å®šæ–¹å¼**

**æ–¹å¼1ï¼šåœ¨Podå®šä¹‰ä¸­æŒ‡å®š**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  serviceAccountName: my-app-sa  # å…³é”®å­—æ®µ
  containers:
  - name: app
    image: nginx:1.20
    # å®¹å™¨å†…è‡ªåŠ¨æŒ‚è½½SA token
```

**æ–¹å¼2ï¼šåœ¨Deploymentä¸­æŒ‡å®š**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app-deployment
spec:
  template:
    spec:
      serviceAccountName: my-app-sa  # æ‰€æœ‰Podéƒ½ä½¿ç”¨æ­¤SA
      containers:
      - name: app
        image: nginx:1.20
```

### 3.4 SAä½¿ç”¨æœ€ä½³å®è·µ


**ğŸŒŸ å®è·µå»ºè®®**

```
1ï¸âƒ£ ä¸€åº”ç”¨ä¸€è´¦æˆ·åŸåˆ™ï¼š
âœ… æ¯ä¸ªåº”ç”¨ä½¿ç”¨ç‹¬ç«‹çš„SA
âŒ å¤šä¸ªåº”ç”¨å…±äº«åŒä¸€ä¸ªSA

2ï¸âƒ£ æƒé™æœ€å°åŒ–åŸåˆ™ï¼š
âœ… åªæˆäºˆå¿…éœ€çš„æƒé™
âŒ ç»™äºˆè¿‡å¤šæƒé™å›¾çœäº‹

3ï¸âƒ£ å‘½åè§„èŒƒï¼š
âœ… app-name-sa, monitoring-sa
âŒ sa1, temp-sa, test

4ï¸âƒ£ æ ‡ç­¾ç®¡ç†ï¼š
âœ… æ·»åŠ appã€versionã€teamæ ‡ç­¾
âŒ æ— æ ‡ç­¾è£¸å¥”
```

---

## 4. ğŸ” Tokenä»¤ç‰Œæœºåˆ¶


### 4.1 Tokenæ˜¯ä»€ä¹ˆ


**ğŸ”‘ é€šä¿—ç†è§£**ï¼šTokenå°±åƒæ˜¯åŠ¨æ€å¯†ç 

```
ç”Ÿæ´»ç±»æ¯”ï¼š
é“¶è¡ŒåŠ¨æ€å¯†ç å¡ â†â†’ K8s Token
â€¢ å®šæœŸæ›´æ¢å¯†ç    â†â†’ Tokenè‡ªåŠ¨è½®æ¢  
â€¢ éªŒè¯èº«ä»½æœ‰æ•ˆ   â†â†’ API ServeréªŒè¯
â€¢ è¿‡æœŸéœ€è¦æ›´æ–°   â†â†’ è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
```

**ğŸ”¸ Tokençš„æœ¬è´¨**
```
JWTä»¤ç‰Œï¼š
â€¢ æ ¼å¼ï¼šJSON Web Token
â€¢ å†…å®¹ï¼šèº«ä»½ä¿¡æ¯+æƒé™+è¿‡æœŸæ—¶é—´
â€¢ ç­¾åï¼šK8sé›†ç¾¤ç§é’¥ç­¾å
â€¢ éªŒè¯ï¼šAPI Serverå…¬é’¥éªŒè¯
```

### 4.2 Tokençš„ç”Ÿå‘½å‘¨æœŸ


**ğŸ“Š Tokenç®¡ç†æµç¨‹å›¾**

```
Tokenç”Ÿå‘½å‘¨æœŸï¼š
åˆ›å»ºSA
   â”‚
   â†“
è‡ªåŠ¨ç”ŸæˆToken â”€â”€â†’ æŒ‚è½½åˆ°Pod
   â”‚                  â”‚
   â†“                  â†“
å®šæœŸè½®æ¢Token â†â”€â”€â”€ Podè‡ªåŠ¨åˆ·æ–°
   â”‚                  â”‚
   â†“                  â†“
Tokenè¿‡æœŸ â”€â”€â”€â”€â†’ è‡ªåŠ¨è·å–æ–°Token
```

**â° Tokenæ—¶é—´ç‰¹æ€§**
```
é»˜è®¤è¿‡æœŸæ—¶é—´ï¼š1å°æ—¶
è‡ªåŠ¨åˆ·æ–°ï¼šè¿‡æœŸå‰è‡ªåŠ¨æ›´æ–°
æœ€å¤§ç”Ÿå­˜æœŸï¼šå–å†³äºé›†ç¾¤é…ç½®
åˆ·æ–°æœºåˆ¶ï¼škubeletè´Ÿè´£åˆ·æ–°
```

### 4.3 æ‰‹åŠ¨ç®¡ç†Token


**ğŸ› ï¸ æ‰‹åŠ¨Tokenæ“ä½œ**

```bash
# 1. æŸ¥çœ‹SAçš„Token
kubectl describe sa my-app-sa

# 2. è·å–Tokenå†…å®¹
kubectl get secret $(kubectl get sa my-app-sa -o jsonpath='{.secrets[0].name}') -o jsonpath='{.data.token}' | base64 -d

# 3. åˆ›å»ºä¸´æ—¶Tokenï¼ˆK8s 1.22+ï¼‰
kubectl create token my-app-sa

# 4. åˆ›å»ºé•¿æœŸTokenï¼ˆå¦‚æœéœ€è¦ï¼‰
kubectl create token my-app-sa --duration=8760h
```

### 4.4 Tokenå®‰å…¨æ³¨æ„äº‹é¡¹


**âš ï¸ å®‰å…¨è¦ç‚¹**

```
ğŸ”’ Tokenä¿æŠ¤ï¼š
â€¢ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç Token
â€¢ ä¸è¦åœ¨æ—¥å¿—ä¸­è¾“å‡ºToken
â€¢ ä¸è¦é€šè¿‡ä¸å®‰å…¨æ¸ é“ä¼ è¾“Token

ğŸ”„ Tokenè½®æ¢ï¼š
â€¢ å®šæœŸæ›´æ¢é•¿æœŸToken
â€¢ ç›‘æ§Tokenä½¿ç”¨æƒ…å†µ
â€¢ åŠæ—¶æ’¤é”€æ³„éœ²çš„Token

ğŸ“‹ å®¡è®¡ç›‘æ§ï¼š
â€¢ è®°å½•Tokenä½¿ç”¨æ—¥å¿—
â€¢ ç›‘æ§å¼‚å¸¸è®¿é—®è¡Œä¸º
â€¢ è®¾ç½®Tokenä½¿ç”¨å‘Šè­¦
```

---

## 5. ğŸ”— æœåŠ¡è´¦æˆ·æƒé™ç»‘å®š


### 5.1 RBACæƒé™æ¨¡å‹


**ğŸ¢ æƒé™ç³»ç»Ÿå°±åƒå…¬å¸ç»„ç»‡æ¶æ„**

```
å…¬å¸æƒé™ç±»æ¯”ï¼š
å‘˜å·¥(ServiceAccount) â†’ è§’è‰²(Role) â†’ æƒé™(æƒé™åˆ—è¡¨)
   â”‚                    â”‚              â”‚
   â†“                    â†“              â†“
å¼ ä¸‰(my-app-sa)    â†’ å¼€å‘è€…(dev-role) â†’ è¯»å–ä»£ç +æäº¤ä»£ç 
æå››(monitor-sa)   â†’ ç›‘æ§å‘˜(ops-role) â†’ æŸ¥çœ‹æ—¥å¿—+é‡å¯æœåŠ¡
```

**ğŸ¯ RBACæ ¸å¿ƒæ¦‚å¿µ**
```
Role/ClusterRoleï¼š
â€¢ å®šä¹‰æƒé™é›†åˆ
â€¢ Roleï¼šå‘½åç©ºé—´çº§åˆ«
â€¢ ClusterRoleï¼šé›†ç¾¤çº§åˆ«

RoleBinding/ClusterRoleBindingï¼š
â€¢ å°†è§’è‰²ç»‘å®šç»™ç”¨æˆ·/SA
â€¢ RoleBindingï¼šå‘½åç©ºé—´ç»‘å®š
â€¢ ClusterRoleBindingï¼šé›†ç¾¤ç»‘å®š
```

### 5.2 åˆ›å»ºRoleå’ŒRoleBinding


**ğŸ“ å®é™…æƒé™é…ç½®ç¤ºä¾‹**

```yaml
# 1. åˆ›å»ºRole - å®šä¹‰æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: pod-reader      # è§’è‰²åï¼šPodè¯»å–è€…
rules:
- apiGroups: [""]       # æ ¸å¿ƒAPIç»„
  resources: ["pods"]   # å¯è®¿é—®çš„èµ„æº
  verbs: ["get", "list", "watch"]  # å…è®¸çš„æ“ä½œ
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["get", "list"]
---
# 2. åˆ›å»ºRoleBinding - ç»‘å®šæƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: default
subjects:               # æƒé™ä¸»ä½“
- kind: ServiceAccount
  name: my-app-sa      # æˆ‘ä»¬çš„SA
  namespace: default
roleRef:               # å¼•ç”¨çš„è§’è‰²
  kind: Role
  name: pod-reader     # ä¸Šé¢å®šä¹‰çš„Role
  apiGroup: rbac.authorization.k8s.io
```

### 5.3 å¸¸ç”¨æƒé™æ¨¡æ¿


**ğŸ¨ å…¸å‹åº”ç”¨æƒé™æ¨¡æ¿**

**æ¨¡æ¿1ï¼šåŸºç¡€åº”ç”¨æƒé™**
```yaml
# é€‚åˆï¼šæ™®é€šä¸šåŠ¡åº”ç”¨
rules:
- apiGroups: [""]
  resources: ["configmaps", "secrets"]
  verbs: ["get", "list"]
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]
```

**æ¨¡æ¿2ï¼šç›‘æ§åº”ç”¨æƒé™**
```yaml
# é€‚åˆï¼šPrometheusç­‰ç›‘æ§å·¥å…·
rules:
- apiGroups: [""]
  resources: ["nodes", "pods", "services", "endpoints"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["apps"]
  resources: ["deployments", "daemonsets"]
  verbs: ["get", "list", "watch"]
```

**æ¨¡æ¿3ï¼šCI/CDæƒé™**
```yaml
# é€‚åˆï¼šGitLab Runnerç­‰CIå·¥å…·
rules:
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "create", "update", "patch"]
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "create", "delete"]
```

### 5.4 æƒé™éªŒè¯å’Œè°ƒè¯•


**ğŸ” æƒé™æµ‹è¯•å‘½ä»¤**

```bash
# 1. æµ‹è¯•SAæ˜¯å¦æœ‰ç‰¹å®šæƒé™
kubectl auth can-i get pods --as=system:serviceaccount:default:my-app-sa

# 2. åˆ—å‡ºSAçš„æ‰€æœ‰æƒé™
kubectl auth can-i --list --as=system:serviceaccount:default:my-app-sa

# 3. åœ¨Podä¸­æµ‹è¯•æƒé™
kubectl exec -it pod-name -- curl -k -H "Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" https://kubernetes.default.svc/api/v1/namespaces/default/pods
```

---

## 6. ğŸš€ å®æˆ˜æ“ä½œæŒ‡å—


### 6.1 å®Œæ•´å®æˆ˜æ¡ˆä¾‹


**ğŸ¯ åœºæ™¯**ï¼šä¸ºWebåº”ç”¨é…ç½®ä¸“ç”¨ServiceAccount

```bash
# æ­¥éª¤1ï¼šåˆ›å»ºServiceAccount
kubectl create sa webapp-sa -n production

# æ­¥éª¤2ï¼šåˆ›å»ºRole
cat <<EOF | kubectl apply -f -
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: production
  name: webapp-role
rules:
- apiGroups: [""]
  resources: ["configmaps", "secrets"]
  verbs: ["get", "list"]
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get"]
EOF

# æ­¥éª¤3ï¼šç»‘å®šæƒé™
kubectl create rolebinding webapp-binding \
  --role=webapp-role \
  --serviceaccount=production:webapp-sa \
  -n production

# æ­¥éª¤4ï¼šéªŒè¯æƒé™
kubectl auth can-i get configmaps \
  --as=system:serviceaccount:production:webapp-sa \
  -n production
```

### 6.2 å¸¸è§é—®é¢˜æ’æŸ¥


**ğŸ”§ é—®é¢˜è¯Šæ–­æ£€æŸ¥æ¸…å•**

```
âœ… SAå­˜åœ¨æ€§æ£€æŸ¥ï¼š
kubectl get sa sa-name -n namespace

âœ… TokenæŒ‚è½½æ£€æŸ¥ï¼š
kubectl exec pod-name -- ls -la /var/run/secrets/kubernetes.io/serviceaccount/

âœ… æƒé™ç»‘å®šæ£€æŸ¥ï¼š
kubectl get rolebinding -n namespace
kubectl describe rolebinding binding-name

âœ… æƒé™éªŒè¯ï¼š
kubectl auth can-i verb resource --as=system:serviceaccount:ns:sa-name

âœ… Pod SAé…ç½®æ£€æŸ¥ï¼š
kubectl get pod pod-name -o yaml | grep serviceAccount
```

### 6.3 è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹


**ğŸ“œ SAç®¡ç†è„šæœ¬**

```bash
#!/bin/bash
# create-app-sa.sh - å¿«é€Ÿåˆ›å»ºåº”ç”¨SA

APP_NAME=$1
NAMESPACE=${2:-default}

if [ -z "$APP_NAME" ]; then
  echo "ä½¿ç”¨æ–¹æ³•: $0 <åº”ç”¨åç§°> [å‘½åç©ºé—´]"
  exit 1
fi

SA_NAME="${APP_NAME}-sa"
ROLE_NAME="${APP_NAME}-role"
BINDING_NAME="${APP_NAME}-binding"

echo "ğŸš€ ä¸ºåº”ç”¨ $APP_NAME åˆ›å»ºServiceAccount..."

# åˆ›å»ºSA
kubectl create sa $SA_NAME -n $NAMESPACE

# åˆ›å»ºåŸºç¡€Role
kubectl create role $ROLE_NAME \
  --verb=get,list,watch \
  --resource=configmaps,secrets,pods \
  -n $NAMESPACE

# åˆ›å»ºç»‘å®š
kubectl create rolebinding $BINDING_NAME \
  --role=$ROLE_NAME \
  --serviceaccount=$NAMESPACE:$SA_NAME \
  -n $NAMESPACE

echo "âœ… ServiceAccount $SA_NAME åˆ›å»ºå®Œæˆï¼"
echo "ğŸ“‹ ä½¿ç”¨æ–¹å¼ï¼šåœ¨Pod specä¸­æ·»åŠ  serviceAccountName: $SA_NAME"
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ServiceAccountæœ¬è´¨ï¼šPodåœ¨K8sé›†ç¾¤ä¸­çš„èº«ä»½è¯
ğŸ”¸ é»˜è®¤æœºåˆ¶ï¼šæ¯ä¸ªnamespaceéƒ½æœ‰default SAï¼Œæƒé™æœ‰é™
ğŸ”¸ Tokenæœºåˆ¶ï¼šJWTä»¤ç‰Œè‡ªåŠ¨æŒ‚è½½ï¼Œå®šæœŸè½®æ¢ä¿è¯å®‰å…¨
ğŸ”¸ RBACç»‘å®šï¼šé€šè¿‡Role+RoleBindingå®ç°æƒé™æ§åˆ¶
ğŸ”¸ æœ€ä½³å®è·µï¼šä¸€åº”ç”¨ä¸€SAï¼Œæƒé™æœ€å°åŒ–åŸåˆ™
```

### 7.2 å…³é”®æ“ä½œå‘½ä»¤é€ŸæŸ¥


```bash
# ServiceAccountç®¡ç†
kubectl create sa sa-name -n namespace
kubectl get sa -n namespace
kubectl describe sa sa-name

# Tokenæ“ä½œ
kubectl create token sa-name
kubectl create token sa-name --duration=1h

# æƒé™éªŒè¯
kubectl auth can-i verb resource --as=system:serviceaccount:ns:sa
kubectl auth can-i --list --as=system:serviceaccount:ns:sa

# RBACç®¡ç†
kubectl create role role-name --verb=get --resource=pods
kubectl create rolebinding binding-name --role=role-name --serviceaccount=ns:sa
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **Webåº”ç”¨**ï¼šè®¿é—®ConfigMapå’ŒSecreté…ç½®
- **ç›‘æ§ç³»ç»Ÿ**ï¼šæ”¶é›†é›†ç¾¤èµ„æºä¿¡æ¯
- **CI/CDæµæ°´çº¿**ï¼šéƒ¨ç½²å’Œç®¡ç†åº”ç”¨
- **æ—¥å¿—æ”¶é›†**ï¼šè®¿é—®Podæ—¥å¿—å’ŒçŠ¶æ€ä¿¡æ¯

**ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ**
- **æƒé™éš”ç¦»**ï¼šä¸åŒåº”ç”¨ä½¿ç”¨ä¸åŒSA
- **æœ€å°æƒé™**ï¼šåªæˆäºˆå¿…è¦çš„æƒé™
- **å®šæœŸè½®æ¢**ï¼šå®šæœŸæ›´æ–°é•¿æœŸToken
- **å®¡è®¡ç›‘æ§**ï¼šè®°å½•å’Œç›‘æ§SAä½¿ç”¨æƒ…å†µ

**ğŸ§  æ ¸å¿ƒè®°å¿†**ï¼š
- ServiceAccount = Podèº«ä»½è¯
- é»˜è®¤SAæƒé™æœ‰é™ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è‡ªå®šä¹‰
- Tokenè‡ªåŠ¨ç®¡ç†ï¼Œå®‰å…¨ä¾¿æ·
- RBACæƒé™ç»‘å®šï¼Œç²¾ç¡®æ§åˆ¶è®¿é—®èŒƒå›´

**å­¦ä¹ è·¯å¾„å»ºè®®**ï¼š
```
ç¬¬1é˜¶æ®µï¼šç†è§£SAæ¦‚å¿µå’Œé»˜è®¤æœºåˆ¶
ç¬¬2é˜¶æ®µï¼šå­¦ä¼šåˆ›å»ºè‡ªå®šä¹‰SAå’ŒåŸºç¡€æƒé™ç»‘å®š  
ç¬¬3é˜¶æ®µï¼šæŒæ¡å¤æ‚æƒé™é…ç½®å’Œæ•…éšœæ’æŸ¥
ç¬¬4é˜¶æ®µï¼šå®ç°è‡ªåŠ¨åŒ–SAç®¡ç†å’Œç›‘æ§
```