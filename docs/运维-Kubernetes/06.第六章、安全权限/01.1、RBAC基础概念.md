---
title: 1ã€RBACåŸºç¡€æ¦‚å¿µ
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯RBAC](#1-ä»€ä¹ˆæ˜¯RBAC)
2. [RBACæ ¸å¿ƒç»„ä»¶è¯¦è§£](#2-RBACæ ¸å¿ƒç»„ä»¶è¯¦è§£)
3. [ç”¨æˆ·ä¸æœåŠ¡è´¦æˆ·](#3-ç”¨æˆ·ä¸æœåŠ¡è´¦æˆ·)
4. [è§’è‰²ä¸æƒé™æœºåˆ¶](#4-è§’è‰²ä¸æƒé™æœºåˆ¶)
5. [æƒé™ç»‘å®šå…³ç³»](#5-æƒé™ç»‘å®šå…³ç³»)
6. [æœ€å°æƒé™åŸåˆ™å®è·µ](#6-æœ€å°æƒé™åŸåˆ™å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä»€ä¹ˆæ˜¯RBAC


### 1.1 RBACç®€å•ç†è§£


**RBACå°±åƒå…¬å¸çš„æƒé™ç®¡ç†ç³»ç»Ÿ**

æƒ³è±¡ä¸€ä¸‹ä½ åœ¨å…¬å¸ä¸Šç­çš„æƒé™ç³»ç»Ÿï¼š

```
ç°å®å…¬å¸æƒé™ï¼š                    Kubernetes RBACï¼š
CEOï¼ˆè€æ¿ï¼‰                      cluster-admin
  â†“                               â†“
éƒ¨é—¨ç»ç†                         namespace-admin  
  â†“                               â†“
æ™®é€šå‘˜å·¥                         æ™®é€šç”¨æˆ·
  â†“                               â†“
å®ä¹ ç”Ÿ                          åªè¯»æƒé™
```

**RBAC = Role-Based Access Controlï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰**

ğŸ”¸ **æ ¸å¿ƒæ€æƒ³**ï¼šä¸æ˜¯ç›´æ¥ç»™ç”¨æˆ·æƒé™ï¼Œè€Œæ˜¯å…ˆå®šä¹‰è§’è‰²ï¼Œå†æŠŠè§’è‰²åˆ†é…ç»™ç”¨æˆ·

```
ä¼ ç»Ÿæ–¹å¼ï¼šç”¨æˆ· â†’ ç›´æ¥è·å¾—æƒé™ï¼ˆæ··ä¹±ï¼‰
RBACæ–¹å¼ï¼šç”¨æˆ· â†’ è§’è‰² â†’ æƒé™ï¼ˆæ¸…æ™°æœ‰åºï¼‰
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦RBAC


**ğŸš¨ æ²¡æœ‰RBACçš„é—®é¢˜**ï¼š
- æƒé™æ··ä¹±ï¼šä¸çŸ¥é“è°æœ‰ä»€ä¹ˆæƒé™
- å®‰å…¨é£é™©ï¼šæƒé™è¿‡å¤§ï¼Œå®¹æ˜“è¯¯æ“ä½œ
- ç®¡ç†å›°éš¾ï¼šäººå‘˜å˜åŠ¨æ—¶æƒé™è°ƒæ•´éº»çƒ¦

**âœ… RBACçš„ä¼˜åŠ¿**ï¼š
- **æƒé™æ¸…æ™°**ï¼šæ¯ä¸ªè§’è‰²çš„æƒé™ä¸€ç›®äº†ç„¶
- **å®‰å…¨å¯æ§**ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œé™ä½é£é™©
- **ç®¡ç†ç®€å•**ï¼šäººå‘˜å˜åŠ¨åªéœ€è°ƒæ•´è§’è‰²ç»‘å®š

### 1.3 Kubernetesä¸­çš„RBAC


åœ¨Kubernetesä¸­ï¼ŒRBACæ§åˆ¶ç€ï¼š

| æƒé™ç±»å‹ | å…·ä½“å†…å®¹ | ç”Ÿæ´»ç±»æ¯” |
|---------|----------|----------|
| ğŸ” **æŸ¥çœ‹æƒé™** | `get, list, watch` | å¯ä»¥çœ‹æ¡£æ¡ˆä½†ä¸èƒ½ä¿®æ”¹ |
| âœï¸ **ä¿®æ”¹æƒé™** | `create, update, patch` | å¯ä»¥ç¼–è¾‘æ–‡æ¡£ |
| ğŸ—‘ï¸ **åˆ é™¤æƒé™** | `delete, deletecollection` | å¯ä»¥åˆ é™¤æ–‡ä»¶ |
| ğŸ”§ **ç®¡ç†æƒé™** | `*`ï¼ˆæ‰€æœ‰æƒé™ï¼‰ | æ‹¥æœ‰å…¨éƒ¨ç®¡ç†æƒé™ |

---

## 2. ğŸ§© RBACæ ¸å¿ƒç»„ä»¶è¯¦è§£


### 2.1 RBACå››å¤§æ ¸å¿ƒç»„ä»¶


```
RBACæƒé™ä½“ç³»ç»“æ„å›¾ï¼š

Subjectï¼ˆä¸»ä½“ï¼‰          Roleï¼ˆè§’è‰²ï¼‰          Resourceï¼ˆèµ„æºï¼‰
     â†“                    â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Role   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Pod    â”‚
â”‚ å¼ ä¸‰ã€æå›› â”‚  ç»‘å®š     â”‚ å¼€å‘è€…    â”‚   æ“ä½œ    â”‚ Service  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ è¿ç»´äººå‘˜   â”‚          â”‚ConfigMap â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†‘
                      RoleBinding
                      ï¼ˆè§’è‰²ç»‘å®šï¼‰
```

**ğŸ”¸ Subjectï¼ˆä¸»ä½“ï¼‰**ï¼šè°è¦è®¿é—®èµ„æºï¼Ÿ
- Userï¼ˆç”¨æˆ·ï¼‰ï¼šçœŸå®çš„äºº
- ServiceAccountï¼ˆæœåŠ¡è´¦æˆ·ï¼‰ï¼šç¨‹åº/Pod

**ğŸ”¸ Roleï¼ˆè§’è‰²ï¼‰**ï¼šå®šä¹‰äº†ä¸€ç»„æƒé™
- æ¯”å¦‚"å¼€å‘è€…"è§’è‰²å¯ä»¥æŸ¥çœ‹Podï¼Œä¸èƒ½åˆ é™¤

**ğŸ”¸ Resourceï¼ˆèµ„æºï¼‰**ï¼šè¦è®¿é—®çš„K8så¯¹è±¡
- Podã€Serviceã€ConfigMapç­‰

**ğŸ”¸ RoleBindingï¼ˆç»‘å®šï¼‰**ï¼šæŠŠè§’è‰²åˆ†é…ç»™ä¸»ä½“
- å¼ ä¸‰ + å¼€å‘è€…è§’è‰² = å¼ ä¸‰æœ‰å¼€å‘è€…æƒé™

### 2.2 è§’è‰²çš„ä¸¤ç§ç±»å‹


| ç±»å‹ | ä½œç”¨èŒƒå›´ | ä½¿ç”¨åœºæ™¯ | ç”Ÿæ´»ç±»æ¯” |
|-----|----------|----------|----------|
| **Role** | å•ä¸ªå‘½åç©ºé—´ | éƒ¨é—¨å†…æƒé™ç®¡ç† | éƒ¨é—¨ç»ç†ï¼ˆåªç®¡æœ¬éƒ¨é—¨ï¼‰ |
| **ClusterRole** | æ•´ä¸ªé›†ç¾¤ | è·¨å‘½åç©ºé—´æƒé™ | å…¬å¸CEOï¼ˆç®¡ç†å…¨å…¬å¸ï¼‰ |

**ğŸ” Roleç¤ºä¾‹**ï¼š
```yaml
# åªèƒ½ç®¡ç† "development" å‘½åç©ºé—´çš„Pod
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: development  # é™å®šåœ¨è¿™ä¸ªå‘½åç©ºé—´
  name: pod-reader
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]
```

**ğŸŒ ClusterRoleç¤ºä¾‹**ï¼š
```yaml
# å¯ä»¥æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤çš„èŠ‚ç‚¹ä¿¡æ¯
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: node-reader
rules:
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["get", "list"]
```

### 2.3 ç»‘å®šçš„ä¸¤ç§ç±»å‹


```
ç»‘å®šç±»å‹å¯¹åº”å…³ç³»ï¼š

Role + RoleBinding = å‘½åç©ºé—´å†…æƒé™
     â†“
   é€‚åˆï¼šå¼€å‘å›¢é˜Ÿåªç®¡ç†è‡ªå·±é¡¹ç›®çš„èµ„æº

ClusterRole + ClusterRoleBinding = é›†ç¾¤çº§æƒé™  
     â†“
   é€‚åˆï¼šè¿ç»´å›¢é˜Ÿéœ€è¦ç®¡ç†æ•´ä¸ªé›†ç¾¤

ClusterRole + RoleBinding = åœ¨ç‰¹å®šå‘½åç©ºé—´ä½¿ç”¨é›†ç¾¤è§’è‰²
     â†“
   é€‚åˆï¼šå¤ç”¨å·²å®šä¹‰çš„é›†ç¾¤è§’è‰²ï¼Œä½†é™åˆ¶åœ¨æŸä¸ªå‘½åç©ºé—´
```

---

## 3. ğŸ‘¥ ç”¨æˆ·ä¸æœåŠ¡è´¦æˆ·


### 3.1 ç”¨æˆ·ï¼ˆUserï¼‰vs æœåŠ¡è´¦æˆ·ï¼ˆServiceAccountï¼‰


**ç®€å•ç†è§£**ï¼š
- **User**ï¼šçœŸäººç”¨æˆ·ï¼ˆä½ ã€æˆ‘ã€è¿ç»´å·¥ç¨‹å¸ˆï¼‰
- **ServiceAccount**ï¼šç¨‹åºç”¨æˆ·ï¼ˆPodã€åº”ç”¨ç¨‹åºï¼‰

```
ç°å®å¯¹æ¯”ï¼š
User = å…¬å¸å‘˜å·¥ï¼Œéœ€è¦åˆ·å¡è¿›å…¥åŠå…¬å®¤
ServiceAccount = è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œéœ€è¦æƒé™è®¿é—®æ•°æ®åº“

Kubernetesä¸­ï¼š
User = é€šè¿‡kubectlæ“ä½œé›†ç¾¤çš„äºº
ServiceAccount = Podä¸­è¿è¡Œçš„åº”ç”¨éœ€è¦è°ƒç”¨K8s API
```

### 3.2 ç”¨æˆ·ç®¡ç†


**âš¡ é‡è¦æ¦‚å¿µ**ï¼šKubernetesä¸ç›´æ¥ç®¡ç†ç”¨æˆ·ï¼

```
Kubernetesç”¨æˆ·è®¤è¯æ–¹å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤–éƒ¨è®¤è¯ç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ è¯ä¹¦è®¤è¯ï¼ˆX.509ï¼‰               â”‚
â”‚ â€¢ LDAP/Active Directory         â”‚
â”‚ â€¢ OpenID Connect                â”‚
â”‚ â€¢ äº‘å¹³å°IAMï¼ˆAWS/Azure/GCPï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
         Kubernetesé›†ç¾¤
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**ï¼š
```yaml
# åˆ›å»ºç”¨æˆ·çš„è¯ä¹¦è¯·æ±‚ï¼ˆç®€åŒ–æµç¨‹ï¼‰
# 1. ç”Ÿæˆç§é’¥
openssl genrsa -out zhang-san.key 2048

# 2. ç”Ÿæˆè¯ä¹¦è¯·æ±‚
openssl req -new -key zhang-san.key -out zhang-san.csr -subj "/CN=zhang-san"

# 3. é›†ç¾¤ç®¡ç†å‘˜ç­¾å‘è¯ä¹¦ï¼ˆå…·ä½“æ­¥éª¤ç•¥ï¼‰
```

### 3.3 æœåŠ¡è´¦æˆ·è¯¦è§£


**æœåŠ¡è´¦æˆ· = Podçš„èº«ä»½è¯**

æ¯ä¸ªPodéƒ½æœ‰ä¸€ä¸ªæœåŠ¡è´¦æˆ·ï¼Œå°±åƒæ¯ä¸ªç¨‹åºéƒ½éœ€è¦ä¸€ä¸ªèº«ä»½æ¥è®¿é—®ç³»ç»Ÿèµ„æºã€‚

**ğŸ”„ æœåŠ¡è´¦æˆ·å·¥ä½œæµç¨‹**ï¼š
```
Podå¯åŠ¨
  â†“
è‡ªåŠ¨æŒ‚è½½ServiceAccount token
  â†“
Podä½¿ç”¨tokenè°ƒç”¨Kubernetes API
  â†“
RBACæ£€æŸ¥æƒé™
  â†“
å…è®¸/æ‹’ç»æ“ä½œ
```

**åˆ›å»ºå’Œä½¿ç”¨æœåŠ¡è´¦æˆ·**ï¼š
```yaml
# åˆ›å»ºæœåŠ¡è´¦æˆ·
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-app-sa
  namespace: production

---
# Podä½¿ç”¨è¿™ä¸ªæœåŠ¡è´¦æˆ·
apiVersion: v1
kind: Pod
metadata:
  name: my-app
  namespace: production
spec:
  serviceAccountName: my-app-sa  # æŒ‡å®šä½¿ç”¨çš„æœåŠ¡è´¦æˆ·
  containers:
  - name: app
    image: my-app:latest
```

**ğŸ’¡ é»˜è®¤æœåŠ¡è´¦æˆ·**ï¼š
- æ¯ä¸ªå‘½åç©ºé—´éƒ½æœ‰ä¸€ä¸ªåä¸º`default`çš„æœåŠ¡è´¦æˆ·
- å¦‚æœPodä¸æŒ‡å®šï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨`default`æœåŠ¡è´¦æˆ·
- é»˜è®¤æœåŠ¡è´¦æˆ·é€šå¸¸æƒé™å¾ˆå°‘ï¼Œç¬¦åˆå®‰å…¨åŸåˆ™

---

## 4. ğŸ­ è§’è‰²ä¸æƒé™æœºåˆ¶


### 4.1 è§’è‰²å®šä¹‰çš„æ ¸å¿ƒè¦ç´ 


**è§’è‰² = ä¸€ç»„æƒé™çš„é›†åˆ**

è§’è‰²å®šä¹‰åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ ï¼š

| è¦ç´  | ä½œç”¨ | ç”Ÿæ´»ç±»æ¯” |
|-----|------|----------|
| **apiGroups** | èµ„æºæ‰€å±çš„APIç»„ | å“ªä¸ªéƒ¨é—¨çš„æƒé™ |
| **resources** | å…·ä½“èµ„æºç±»å‹ | å…·ä½“æ–‡ä»¶ç±»å‹ |
| **verbs** | å…è®¸çš„æ“ä½œ | å¯ä»¥è¿›è¡Œçš„åŠ¨ä½œ |

### 4.2 APIç»„ï¼ˆapiGroupsï¼‰ç†è§£


**APIç»„å°±åƒèµ„æºçš„åˆ†ç±»**ï¼š

```
Kubernetes APIç»„åˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ¸å¿ƒç»„ï¼ˆ""æˆ–coreï¼‰                    â”‚
â”‚ â”œâ”€ Podã€Serviceã€ConfigMap            â”‚
â”‚ â”œâ”€ Nodeã€Namespace                   â”‚
â”‚ â””â”€ Secretã€PersistentVolume          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ appsç»„                               â”‚
â”‚ â”œâ”€ Deploymentã€ReplicaSet            â”‚
â”‚ â””â”€ DaemonSetã€StatefulSet            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ networking.k8s.ioç»„                  â”‚
â”‚ â”œâ”€ Ingressã€NetworkPolicy             â”‚
â”‚ â””â”€ IngressClass                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å®é™…é…ç½®ç¤ºä¾‹**ï¼š
```yaml
rules:
# æ ¸å¿ƒç»„èµ„æºï¼ˆæ³¨æ„ç©ºå­—ç¬¦ä¸²""ï¼‰
- apiGroups: [""]
  resources: ["pods", "services"]
  verbs: ["get", "list"]

# appsç»„èµ„æº  
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "create", "update"]

# å¤šä¸ªç»„ä¸€èµ·æŒ‡å®š
- apiGroups: ["", "apps", "extensions"]
  resources: ["*"]  # æ‰€æœ‰èµ„æº
  verbs: ["*"]      # æ‰€æœ‰æƒé™
```

### 4.3 åŠ¨ä½œæƒé™ï¼ˆverbsï¼‰è¯¦è§£


**åŠ¨ä½œæƒé™å¯¹ç…§è¡¨**ï¼š

| åŠ¨ä½œ | å«ä¹‰ | HTTPæ–¹æ³• | å®é™…æ“ä½œ |
|-----|------|----------|----------|
| **get** | è·å–å•ä¸ªèµ„æº | GET | `kubectl get pod my-pod` |
| **list** | åˆ—å‡ºå¤šä¸ªèµ„æº | GET | `kubectl get pods` |
| **watch** | ç›‘å¬èµ„æºå˜åŒ– | GET(stream) | å®æ—¶ç›‘æ§èµ„æºçŠ¶æ€ |
| **create** | åˆ›å»ºèµ„æº | POST | `kubectl create -f pod.yaml` |
| **update** | æ›´æ–°æ•´ä¸ªèµ„æº | PUT | `kubectl replace -f pod.yaml` |
| **patch** | éƒ¨åˆ†æ›´æ–°èµ„æº | PATCH | `kubectl patch pod my-pod` |
| **delete** | åˆ é™¤å•ä¸ªèµ„æº | DELETE | `kubectl delete pod my-pod` |
| **deletecollection** | æ‰¹é‡åˆ é™¤ | DELETE | `kubectl delete pods --all` |

**ğŸ¯ å¸¸ç”¨æƒé™ç»„åˆ**ï¼š

**åªè¯»æƒé™ï¼ˆé€‚åˆå¼€å‘è€…æŸ¥çœ‹ï¼‰**ï¼š
```yaml
verbs: ["get", "list", "watch"]
```

**ç¼–è¾‘æƒé™ï¼ˆé€‚åˆå¼€å‘è€…æ“ä½œï¼‰**ï¼š
```yaml
verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
```

**å®Œå…¨æƒé™ï¼ˆé€‚åˆç®¡ç†å‘˜ï¼‰**ï¼š
```yaml
verbs: ["*"]  # åŒ…å«æ‰€æœ‰æƒé™
```

### 4.4 è§’è‰²ç¤ºä¾‹åˆ†æ


**ğŸ” å¼€å‘è€…è§’è‰²ç¤ºä¾‹**ï¼š
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: development
  name: developer
rules:
# å¯ä»¥ç®¡ç†Pod
- apiGroups: [""]
  resources: ["pods", "pods/log", "pods/exec"]
  verbs: ["get", "list", "watch", "create", "delete"]

# å¯ä»¥ç®¡ç†Deployment  
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

# åªèƒ½æŸ¥çœ‹Secretï¼ˆä¸èƒ½ä¿®æ”¹ï¼‰
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list"]
```

**è§£é‡Š**ï¼šè¿™ä¸ªè§’è‰²è®©å¼€å‘è€…èƒ½å¤Ÿï¼š
- âœ… åˆ›å»ºå’Œåˆ é™¤Podï¼ŒæŸ¥çœ‹æ—¥å¿—
- âœ… ç®¡ç†åº”ç”¨éƒ¨ç½²ï¼ˆDeploymentï¼‰
- âœ… æŸ¥çœ‹ç§˜é’¥ä½†ä¸èƒ½ä¿®æ”¹ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰

---

## 5. ğŸ”— æƒé™ç»‘å®šå…³ç³»


### 5.1 RoleBindingåŸºç¡€


**RoleBinding = æŠŠè§’è‰²åˆ†é…ç»™ç”¨æˆ·**

```
ç»‘å®šå…³ç³»å›¾ï¼š
Subjectï¼ˆè°ï¼‰    +    Roleï¼ˆä»€ä¹ˆæƒé™ï¼‰    =    RoleBindingï¼ˆç»‘å®šï¼‰
     â†“                      â†“                        â†“
   å¼ ä¸‰                   å¼€å‘è€…è§’è‰²              å¼ ä¸‰è·å¾—å¼€å‘æƒé™
   æå››                   è¿ç»´è§’è‰²                æå››è·å¾—è¿ç»´æƒé™
  Pod A                  åªè¯»è§’è‰²               Pod Aåªèƒ½è¯»å–èµ„æº
```

### 5.2 RoleBindingé…ç½®è¯¦è§£


**ğŸ’¡ åŸºæœ¬RoleBindingç¤ºä¾‹**ï¼š
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: developer-binding
  namespace: development
subjects:  # ä¸»ä½“åˆ—è¡¨ï¼ˆå¯ä»¥ç»‘å®šå¤šä¸ªï¼‰
- kind: User
  name: zhang-san
  apiGroup: rbac.authorization.k8s.io
- kind: User  
  name: li-si
  apiGroup: rbac.authorization.k8s.io
- kind: ServiceAccount
  name: my-app-sa
  namespace: development
roleRef:   # å¼•ç”¨çš„è§’è‰²
  kind: Role
  name: developer  # å¼•ç”¨å‰é¢å®šä¹‰çš„developerè§’è‰²
  apiGroup: rbac.authorization.k8s.io
```

**è¿™ä¸ªé…ç½®çš„å«ä¹‰**ï¼š
- å¼ ä¸‰ã€æå››ã€my-app-sa éƒ½è·å¾—äº† `developer` è§’è‰²çš„æƒé™
- æƒé™åªåœ¨ `development` å‘½åç©ºé—´æœ‰æ•ˆ

### 5.3 ClusterRoleBindingè¯¦è§£


**ClusterRoleBindingç”¨äºé›†ç¾¤çº§æƒé™ç»‘å®š**ï¼š

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-admin-binding
subjects:
- kind: User
  name: admin-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-admin  # K8så†…ç½®çš„é›†ç¾¤ç®¡ç†å‘˜è§’è‰²
  apiGroup: rbac.authorization.k8s.io
```

### 5.4 ç»‘å®šæ¨¡å¼å¯¹æ¯”


| ç»‘å®šç±»å‹ | è§’è‰²ç±»å‹ | æƒé™èŒƒå›´ | ä½¿ç”¨åœºæ™¯ |
|---------|----------|----------|----------|
| **RoleBinding** | Role | å½“å‰å‘½åç©ºé—´ | å›¢é˜Ÿé¡¹ç›®ç®¡ç† |
| **RoleBinding** | ClusterRole | å½“å‰å‘½åç©ºé—´ | å¤ç”¨é›†ç¾¤è§’è‰² |
| **ClusterRoleBinding** | ClusterRole | æ•´ä¸ªé›†ç¾¤ | é›†ç¾¤ç®¡ç†å‘˜ |

**ğŸ”„ å¤ç”¨é›†ç¾¤è§’è‰²ç¤ºä¾‹**ï¼š
```yaml
# ä½¿ç”¨å†…ç½®çš„view ClusterRoleï¼Œä½†åªåœ¨ç‰¹å®šå‘½åç©ºé—´ç”Ÿæ•ˆ
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-only-binding
  namespace: production
subjects:
- kind: User
  name: intern-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: view  # ä½¿ç”¨K8så†…ç½®çš„åªè¯»é›†ç¾¤è§’è‰²
  apiGroup: rbac.authorization.k8s.io
```

---

## 6. ğŸ›¡ï¸ æœ€å°æƒé™åŸåˆ™å®è·µ


### 6.1 ä»€ä¹ˆæ˜¯æœ€å°æƒé™åŸåˆ™


**æœ€å°æƒé™åŸåˆ™ = åªç»™å¿…éœ€çš„æœ€å°‘æƒé™**

```
âŒ é”™è¯¯åšæ³•ï¼š
ä¸ºäº†çœäº‹ï¼Œç»™æ‰€æœ‰ç”¨æˆ·cluster-adminæƒé™

âœ… æ­£ç¡®åšæ³•ï¼š
æ ¹æ®å·¥ä½œéœ€è¦ï¼Œç²¾ç¡®åˆ†é…æƒé™

ç°å®ç±»æ¯”ï¼š
âŒ ç»™å®ä¹ ç”ŸCEOçš„æƒé™
âœ… ç»™å®ä¹ ç”Ÿåªèƒ½è®¿é—®å¿…è¦æ–‡ä»¶çš„æƒé™
```

### 6.2 æƒé™åˆ†å±‚è®¾è®¡


**ğŸ¢ ä¼ä¸šçº§æƒé™åˆ†å±‚**ï¼š

```
æƒé™é‡‘å­—å¡”ï¼š

         ğŸ”´ cluster-admin
          (é›†ç¾¤è¶…çº§ç®¡ç†å‘˜)
               â†“
       ğŸŸ¡ namespace-admin  
        (å‘½åç©ºé—´ç®¡ç†å‘˜)
               â†“
         ğŸŸ¢ developer
         (åº”ç”¨å¼€å‘è€…)
               â†“
          ğŸ”µ viewer
          (åªè¯»ç”¨æˆ·)
```

**å„å±‚æƒé™è®¾è®¡**ï¼š

| è§’è‰²å±‚çº§ | æƒé™èŒƒå›´ | å…¸å‹æƒé™ | é€‚ç”¨äººç¾¤ |
|---------|----------|----------|----------|
| **ğŸ”´ Cluster Admin** | æ•´ä¸ªé›†ç¾¤ | æ‰€æœ‰èµ„æºçš„å…¨éƒ¨æƒé™ | å¹³å°è¿ç»´å›¢é˜Ÿ |
| **ğŸŸ¡ Namespace Admin** | å•ä¸ªå‘½åç©ºé—´ | å‘½åç©ºé—´å†…æ‰€æœ‰èµ„æº | é¡¹ç›®è´Ÿè´£äºº |
| **ğŸŸ¢ Developer** | åº”ç”¨ç›¸å…³èµ„æº | éƒ¨ç½²ã€Podã€Serviceç­‰ | å¼€å‘å·¥ç¨‹å¸ˆ |
| **ğŸ”µ Viewer** | åªè¯»æƒé™ | getã€listã€watch | ä¸šåŠ¡äººå‘˜ã€å®ä¹ ç”Ÿ |

### 6.3 å®é™…æƒé™è®¾è®¡æ¡ˆä¾‹


**ğŸ“± ä»¥ç”µå•†åº”ç”¨ä¸ºä¾‹**ï¼š

```yaml
# 1. åªè¯»è§’è‰²ï¼ˆå®¢æœã€äº§å“ç»ç†ï¼‰
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: ecommerce
  name: app-viewer
rules:
- apiGroups: ["", "apps"]
  resources: ["pods", "services", "deployments"]
  verbs: ["get", "list", "watch"]
- apiGroups: [""]
  resources: ["pods/log"]  # å¯ä»¥çœ‹æ—¥å¿—æ’æŸ¥é—®é¢˜
  verbs: ["get"]

---
# 2. å¼€å‘è€…è§’è‰²ï¼ˆåç«¯å¼€å‘ï¼‰
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: ecommerce
  name: backend-developer
rules:
- apiGroups: ["", "apps"]
  resources: ["pods", "services", "deployments", "configmaps"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list"]  # åªèƒ½è¯»å–ï¼Œä¸èƒ½ä¿®æ”¹ç§˜é’¥
- apiGroups: [""]
  resources: ["pods/exec", "pods/log"]
  verbs: ["get", "create"]  # å¯ä»¥è¿›å…¥Podè°ƒè¯•

---
# 3. DevOpsè§’è‰²ï¼ˆè¿ç»´å·¥ç¨‹å¸ˆï¼‰
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: ecommerce  
  name: devops-admin
rules:
- apiGroups: ["*"]
  resources: ["*"]  # å‘½åç©ºé—´å†…çš„å®Œå…¨æƒé™
  verbs: ["*"]
```

### 6.4 æƒé™å®¡è®¡ä¸ç›‘æ§


**ğŸ” æƒé™å®¡è®¡æ£€æŸ¥æ¸…å•**ï¼š

âœ… **å®šæœŸå®¡è®¡æ£€æŸ¥**ï¼š
- [ ] ç”¨æˆ·æƒé™æ˜¯å¦ä¸å·¥ä½œèŒè´£åŒ¹é…
- [ ] æ˜¯å¦å­˜åœ¨è¿‡åº¦æˆæƒ
- [ ] ç¦»èŒäººå‘˜æƒé™æ˜¯å¦åŠæ—¶å›æ”¶
- [ ] ServiceAccountæƒé™æ˜¯å¦æœ€å°åŒ–

**âš ï¸ å¸¸è§æƒé™é£é™©**ï¼š

| é£é™©ç±»å‹ | å…·ä½“è¡¨ç° | é£é™©ç­‰çº§ | è§£å†³æ–¹æ¡ˆ |
|---------|----------|----------|----------|
| **æƒé™è¿‡å¤§** | å¼€å‘è€…æ‹¥æœ‰åˆ é™¤ç”Ÿäº§ç¯å¢ƒæƒé™ | ğŸ”´ é«˜å± | æŒ‰ç¯å¢ƒä¸¥æ ¼åˆ†ç¦» |
| **æ°¸ä¹…æƒé™** | ä¸´æ—¶éœ€æ±‚è·å¾—çš„æƒé™æœªå›æ”¶ | ğŸŸ¡ ä¸­å± | å®šæœŸæƒé™å®¡è®¡ |
| **å…±äº«è´¦æˆ·** | å¤šäººä½¿ç”¨åŒä¸€ä¸ªServiceAccount | ğŸŸ¡ ä¸­å± | æŒ‰åº”ç”¨ç‹¬ç«‹è´¦æˆ· |

### 6.5 åŠ¨æ€æƒé™ç®¡ç†


**ğŸ”„ åŸºäºåœºæ™¯çš„æƒé™ç®¡ç†**ï¼š

```yaml
# ç”Ÿäº§ç¯å¢ƒï¼šä¸¥æ ¼æƒé™
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: prod-developer
  namespace: production
subjects:
- kind: User
  name: senior-dev
roleRef:
  kind: Role
  name: read-only-developer  # ç”Ÿäº§ç¯å¢ƒåªè¯»

---
# å¼€å‘ç¯å¢ƒï¼šå®½æ¾æƒé™  
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: dev-developer
  namespace: development
subjects:
- kind: User
  name: senior-dev
roleRef:
  kind: Role
  name: full-developer  # å¼€å‘ç¯å¢ƒå®Œå…¨æƒé™
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ RBACå››è¦ç´ **ï¼š
- **Subjectï¼ˆä¸»ä½“ï¼‰**ï¼šè°è¦è®¿é—®ï¼Ÿï¼ˆUser/ServiceAccountï¼‰
- **Roleï¼ˆè§’è‰²ï¼‰**ï¼šæœ‰ä»€ä¹ˆæƒé™ï¼Ÿï¼ˆæƒé™é›†åˆï¼‰
- **Resourceï¼ˆèµ„æºï¼‰**ï¼šè®¿é—®ä»€ä¹ˆï¼Ÿï¼ˆPod/Serviceç­‰ï¼‰
- **Bindingï¼ˆç»‘å®šï¼‰**ï¼šä¸»ä½“è·å¾—è§’è‰²æƒé™

**ğŸ”‘ æƒé™æ§åˆ¶ä¸‰è¦ç´ **ï¼š
- **apiGroups**ï¼šèµ„æºåˆ†ç±»ï¼ˆcoreã€appsç­‰ï¼‰
- **resources**ï¼šå…·ä½“èµ„æºç±»å‹ï¼ˆpodsã€deploymentsï¼‰
- **verbs**ï¼šå…è®¸çš„æ“ä½œï¼ˆgetã€createã€deleteï¼‰

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è§’è‰²vsç»‘å®šçš„åŒºåˆ«**ï¼š
```
è§’è‰²ï¼ˆRole/ClusterRoleï¼‰ï¼š
â€¢ å®šä¹‰æƒé™æ¨¡æ¿
â€¢ å¯é‡å¤ä½¿ç”¨
â€¢ ç±»ä¼¼"å·¥ä½œå²—ä½èŒè´£"

ç»‘å®šï¼ˆRoleBinding/ClusterRoleBindingï¼‰ï¼š
â€¢ åˆ†é…æƒé™ç»™å…·ä½“äººå‘˜  
â€¢ å»ºç«‹ä¸»ä½“å’Œè§’è‰²çš„å…³ç³»
â€¢ ç±»ä¼¼"ä»»å‘½ä¹¦"
```

**ğŸ”¹ å‘½åç©ºé—´vsé›†ç¾¤æƒé™**ï¼š
```
å‘½åç©ºé—´çº§åˆ«ï¼ˆRole + RoleBindingï¼‰ï¼š
â€¢ æƒé™é™åˆ¶åœ¨å•ä¸ªå‘½åç©ºé—´
â€¢ é€‚åˆé¡¹ç›®å›¢é˜Ÿç®¡ç†
â€¢ æ›´å®‰å…¨ã€éš”ç¦»æ€§å¥½

é›†ç¾¤çº§åˆ«ï¼ˆClusterRole + ClusterRoleBindingï¼‰ï¼š
â€¢ æƒé™è¦†ç›–æ•´ä¸ªé›†ç¾¤
â€¢ é€‚åˆå¹³å°ç®¡ç†å‘˜
â€¢ æƒé™æ›´å¤§ã€è´£ä»»æ›´å¤§
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¨ æƒé™è®¾è®¡æœ€ä½³å®è·µ**ï¼š

1. **ğŸ›¡ï¸ æœ€å°æƒé™åŸåˆ™**
   - åªç»™å¿…éœ€æƒé™ï¼Œä¸å¤šç»™
   - ä¼˜å…ˆé€‰æ‹©åªè¯»æƒé™
   - å®šæœŸå®¡è®¡å’Œå›æ”¶

2. **ğŸ—ï¸ åˆ†å±‚æƒé™è®¾è®¡**
   - æŒ‰èŒè´£åˆ†å±‚ï¼šç®¡ç†å‘˜â†’å¼€å‘è€…â†’æŸ¥çœ‹è€…
   - æŒ‰ç¯å¢ƒåˆ†ç¦»ï¼šç”Ÿäº§â†’æµ‹è¯•â†’å¼€å‘
   - æŒ‰å›¢é˜Ÿåˆ’åˆ†ï¼šå‰ç«¯â†’åç«¯â†’è¿ç»´

3. **ğŸ”„ åŠ¨æ€æƒé™ç®¡ç†**
   - æ–°å‘˜å·¥ï¼šä»æœ€å°æƒé™å¼€å§‹
   - é¡¹ç›®éœ€è¦ï¼šä¸´æ—¶æƒé™ï¼Œç»“æŸåå›æ”¶
   - ç¯å¢ƒåˆ‡æ¢ï¼šä¸åŒç¯å¢ƒä¸åŒæƒé™

**âš ï¸ å¸¸è§é”™è¯¯é¿å…**ï¼š

```
âŒ ä¸ºäº†æ–¹ä¾¿ç»™æ‰€æœ‰äººcluster-adminæƒé™
âœ… æŒ‰å®é™…éœ€è¦ç²¾ç¡®åˆ†é…æƒé™

âŒ ç›´æ¥ç»™ç”¨æˆ·æƒé™ï¼Œç»•è¿‡è§’è‰²
âœ… é€šè¿‡è§’è‰²é—´æ¥åˆ†é…æƒé™

âŒ ç”Ÿäº§å’Œå¼€å‘ä½¿ç”¨ç›¸åŒæƒé™
âœ… ç”Ÿäº§ç¯å¢ƒæƒé™æ›´ä¸¥æ ¼

âŒ å¿˜è®°å›æ”¶ä¸´æ—¶æƒé™
âœ… å®šæœŸå®¡è®¡ï¼ŒåŠæ—¶æ¸…ç†
```

### 7.4 å­¦ä¹ æ£€æŸ¥ç‚¹


âœ… **åŸºç¡€ç†è§£æ£€æŸ¥**ï¼š
- [ ] èƒ½è§£é‡ŠRBACçš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨
- [ ] ç†è§£Subjectã€Roleã€Resourceã€Bindingçš„å…³ç³»
- [ ] çŸ¥é“Roleå’ŒClusterRoleçš„åŒºåˆ«

âœ… **å®è·µèƒ½åŠ›æ£€æŸ¥**ï¼š
- [ ] èƒ½åˆ›å»ºåŸºæœ¬çš„Roleå’ŒRoleBinding
- [ ] ä¼šé…ç½®ä¸åŒæƒé™çº§åˆ«çš„è§’è‰²
- [ ] èƒ½ä¸ºå…·ä½“åœºæ™¯è®¾è®¡æƒé™æ–¹æ¡ˆ

âœ… **å®‰å…¨æ„è¯†æ£€æŸ¥**ï¼š
- [ ] ç†è§£æœ€å°æƒé™åŸåˆ™çš„é‡è¦æ€§
- [ ] çŸ¥é“å¦‚ä½•è¿›è¡Œæƒé™å®¡è®¡
- [ ] èƒ½è¯†åˆ«å¸¸è§çš„æƒé™é£é™©

**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
RBACæƒé™å››è¦ç´ ï¼Œä¸»ä½“è§’è‰²èµ„æºç»‘å®š
æœ€å°æƒé™æ˜¯åŸåˆ™ï¼Œåˆ†å±‚è®¾è®¡ä¿å®‰å…¨
ç”¨æˆ·æœåŠ¡è¦åŒºåˆ†ï¼Œå‘½åç©ºé—´é›†ç¾¤åˆ†
å®šæœŸå®¡è®¡å‹¤æ£€æŸ¥ï¼Œæƒé™ç®¡ç†ä¸é©¬è™
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- RBACæ˜¯Kuberneteså®‰å…¨çš„åŸºçŸ³ï¼Œé€šè¿‡è§’è‰²ç®¡ç†æƒé™
- æœ€å°æƒé™åŸåˆ™æ˜¯å®‰å…¨è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³
- æƒé™åˆ†å±‚è®¾è®¡è®©ç®¡ç†æ›´æ¸…æ™°ã€æ›´å®‰å…¨
- å®šæœŸå®¡è®¡æ˜¯æƒé™å®‰å…¨çš„å¿…è¦ä¿éšœ