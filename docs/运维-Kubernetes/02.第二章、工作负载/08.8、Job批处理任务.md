---
title: 8ã€Jobæ‰¹å¤„ç†ä»»åŠ¡
---
## ğŸ“š ç›®å½•

1. [Jobä¸€æ¬¡æ€§ä»»åŠ¡æ¦‚å¿µ](#1-Jobä¸€æ¬¡æ€§ä»»åŠ¡æ¦‚å¿µ)
2. [ä»»åŠ¡å®Œæˆæ¡ä»¶è®¾ç½®](#2-ä»»åŠ¡å®Œæˆæ¡ä»¶è®¾ç½®)
3. [å¹¶è¡Œä»»åŠ¡æ‰§è¡Œæ§åˆ¶](#3-å¹¶è¡Œä»»åŠ¡æ‰§è¡Œæ§åˆ¶)
4. [ä»»åŠ¡å¤±è´¥é‡è¯•æœºåˆ¶](#4-ä»»åŠ¡å¤±è´¥é‡è¯•æœºåˆ¶)
5. [ä»»åŠ¡æ¸…ç†ç­–ç•¥](#5-ä»»åŠ¡æ¸…ç†ç­–ç•¥)
6. [æ‰¹å¤„ç†åº”ç”¨åœºæ™¯](#6-æ‰¹å¤„ç†åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Jobä¸€æ¬¡æ€§ä»»åŠ¡æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Jobï¼Ÿ


**ç®€å•ç†è§£**ï¼šJobå°±åƒæ˜¯ç»™ä½ å®‰æ’çš„ä¸€ä¸ªå…·ä½“å·¥ä½œä»»åŠ¡ï¼Œåšå®Œå°±ç»“æŸï¼Œä¸åƒæ™®é€šçš„Podéœ€è¦ä¸€ç›´è¿è¡Œç€ã€‚

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
æ™®é€šPod = 24å°æ—¶è¥ä¸šçš„ä¾¿åˆ©åº— (ä¸€ç›´è¿è¡Œ)
Jobä»»åŠ¡ = æ¬å®¶å…¬å¸çš„æ¬è¿å·¥ä½œ (å®Œæˆå°±ç»“æŸ)
```

**ğŸ”¸ Jobçš„æ ¸å¿ƒç‰¹ç‚¹**
```
âœ… ä¸€æ¬¡æ€§æ‰§è¡Œï¼šä»»åŠ¡å®ŒæˆåPodå°±ä¼šåœæ­¢
âœ… ä¿è¯å®Œæˆï¼šç¡®ä¿ä»»åŠ¡æˆåŠŸæ‰§è¡Œå®Œæ¯•
âœ… å¤±è´¥é‡è¯•ï¼šå¦‚æœå¤±è´¥ä¼šè‡ªåŠ¨é‡æ–°å°è¯•
âœ… å¯ä»¥å¹¶è¡Œï¼šæ”¯æŒåŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡
```

### 1.2 Jobä¸Podçš„åŒºåˆ«


| å¯¹æ¯”é¡¹ç›® | **Pod** | **Job** |
|---------|---------|---------|
| ğŸ”„ **è¿è¡Œæ¨¡å¼** | `æŒç»­è¿è¡Œ` | `è¿è¡Œå®Œå°±ç»“æŸ` |
| ğŸ¯ **ä½¿ç”¨åœºæ™¯** | `WebæœåŠ¡ã€APIæœåŠ¡` | `æ•°æ®å¤‡ä»½ã€æ‰¹é‡å¤„ç†` |
| â™»ï¸ **é‡å¯ç­–ç•¥** | `Always(æ€»æ˜¯é‡å¯)` | `Never/OnFailure(å¤±è´¥æ‰é‡å¯)` |
| ğŸ“Š **æˆåŠŸæ ‡å‡†** | `ä¿æŒè¿è¡ŒçŠ¶æ€` | `è¿›ç¨‹æ­£å¸¸é€€å‡º(é€€å‡ºç 0)` |

### 1.3 Jobå·¥ä½œåŸç†å›¾è§£


```
ä»»åŠ¡æ‰§è¡Œæµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºJob  â”‚ -> â”‚  å¯åŠ¨Pod  â”‚ -> â”‚  æ‰§è¡Œä»»åŠ¡  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      |
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ ä»»åŠ¡å®Œæˆ  â”‚ <- â”‚  ç›‘æ§çŠ¶æ€  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      |
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Podç»ˆæ­¢  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âœ… ä»»åŠ¡å®Œæˆæ¡ä»¶è®¾ç½®


### 2.1 æˆåŠŸå®Œæˆçš„æ ‡å‡†


**ğŸ”¸ ä»€ä¹ˆå«ä»»åŠ¡"å®Œæˆ"ï¼Ÿ**
- **è¿›ç¨‹æ­£å¸¸é€€å‡º**ï¼šç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œé€€å‡ºç ä¸º0
- **æ²¡æœ‰é”™è¯¯å‘ç”Ÿ**ï¼šç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰å´©æºƒ
- **è¾¾åˆ°æœŸæœ›ç»“æœ**ï¼šå®Œæˆäº†é¢„æœŸçš„å·¥ä½œ

### 2.2 åŸºç¡€Jobé…ç½®


```yaml
# æœ€ç®€å•çš„Jobç¤ºä¾‹
apiVersion: batch/v1
kind: Job
metadata:
  name: hello-job
spec:
  template:
    spec:
      containers:
      - name: hello
        image: busybox
        command: ['sh', '-c', 'echo "Hello Kubernetes Job!" && sleep 30']
      restartPolicy: Never  # é‡è¦ï¼Jobå¿…é¡»è®¾ç½®ä¸ºNeveræˆ–OnFailure
```

**âš ï¸ é‡è¦é…ç½®è¯´æ˜**ï¼š
- `restartPolicy: Never` - ä»»åŠ¡å¤±è´¥ä¸é‡å¯ï¼Œè®©Jobæ§åˆ¶å™¨å¤„ç†
- `restartPolicy: OnFailure` - ä»»åŠ¡å¤±è´¥åœ¨åŒä¸€ä¸ªPodä¸­é‡å¯

### 2.3 completionsï¼šè®¾ç½®æˆåŠŸæ¬¡æ•°


**ğŸ”¸ ä»€ä¹ˆæ˜¯completionsï¼Ÿ**
completionså‘Šè¯‰Kubernetesï¼š"è¿™ä¸ªä»»åŠ¡éœ€è¦æˆåŠŸå®Œæˆå‡ æ¬¡æ‰ç®—çœŸæ­£å®Œæˆ"

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: multi-completion-job
spec:
  completions: 3  # éœ€è¦æˆåŠŸå®Œæˆ3æ¬¡
  template:
    spec:
      containers:
      - name: worker
        image: busybox
        command: ['sh', '-c', 'echo "Task completed: $(date)" && sleep 10']
      restartPolicy: Never
```

**æ‰§è¡Œè¿‡ç¨‹**ï¼š
```
æ—¶é—´è½´ï¼š
Pod-1 å¯åŠ¨ -> å®Œæˆ -> ç»ˆæ­¢ âœ… (1/3)
Pod-2 å¯åŠ¨ -> å®Œæˆ -> ç»ˆæ­¢ âœ… (2/3)  
Pod-3 å¯åŠ¨ -> å®Œæˆ -> ç»ˆæ­¢ âœ… (3/3)
Job æ ‡è®°ä¸ºå®Œæˆï¼
```

### 2.4 è®¾ç½®ä»»åŠ¡è¶…æ—¶æ—¶é—´


```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: timeout-job
spec:
  activeDeadlineSeconds: 300  # 5åˆ†é’Ÿè¶…æ—¶
  template:
    spec:
      containers:
      - name: long-task
        image: busybox
        command: ['sh', '-c', 'sleep 600']  # æ•…æ„è®©å®ƒè¿è¡Œ10åˆ†é’Ÿ
      restartPolicy: Never
```

**ğŸ• è¶…æ—¶å¤„ç†**ï¼š
- å¦‚æœ5åˆ†é’Ÿå†…ä»»åŠ¡æ²¡å®Œæˆï¼ŒJobä¼šè¢«ç»ˆæ­¢
- æ‰€æœ‰ç›¸å…³çš„Podéƒ½ä¼šè¢«åˆ é™¤
- JobçŠ¶æ€æ ‡è®°ä¸ºå¤±è´¥

---

## 3. ğŸ”„ å¹¶è¡Œä»»åŠ¡æ‰§è¡Œæ§åˆ¶


### 3.1 ä»€ä¹ˆæ˜¯å¹¶è¡Œæ‰§è¡Œï¼Ÿ


**ç®€å•ç†è§£**ï¼šå°±åƒå·¥å‚æµæ°´çº¿ä¸€æ ·ï¼Œå¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ªå·¥äººä¸€èµ·å¹²æ´»ï¼Œæé«˜æ•ˆç‡ã€‚

```
ä¸²è¡Œæ‰§è¡Œï¼ˆé»˜è®¤ï¼‰ï¼š
å·¥äºº1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (12ç§’)
æ€»æ—¶é—´: 12ç§’

å¹¶è¡Œæ‰§è¡Œï¼š
å·¥äºº1: â–ˆâ–ˆâ–ˆâ–ˆ (4ç§’)
å·¥äºº2: â–ˆâ–ˆâ–ˆâ–ˆ (4ç§’)  
å·¥äºº3: â–ˆâ–ˆâ–ˆâ–ˆ (4ç§’)
æ€»æ—¶é—´: 4ç§’
```

### 3.2 parallelismï¼šæ§åˆ¶å¹¶è¡Œåº¦


```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: parallel-job
spec:
  completions: 6      # æ€»å…±è¦å®Œæˆ6ä¸ªä»»åŠ¡
  parallelism: 2      # åŒæ—¶æœ€å¤šè¿è¡Œ2ä¸ªPod
  template:
    spec:
      containers:
      - name: worker
        image: busybox
        command: ['sh', '-c', 'echo "Worker $(hostname) starting" && sleep 20 && echo "Worker $(hostname) done"']
      restartPolicy: Never
```

**æ‰§è¡Œæ—¶é—´çº¿**ï¼š
```
æ—¶é—´: 0s    10s   20s   30s   40s   60s
Pod1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (å®Œæˆ)
Pod2: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (å®Œæˆ)      âœ… 2ä¸ªå®Œæˆ
Pod3:           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (å®Œæˆ)  
Pod4:           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (å®Œæˆ)  âœ… 4ä¸ªå®Œæˆ
Pod5:                     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (å®Œæˆ)
Pod6:                     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (å®Œæˆ) âœ… 6ä¸ªå…¨éƒ¨å®Œæˆ
```

### 3.3 å·¥ä½œé˜Ÿåˆ—æ¨¡å¼


**ğŸ”¸ ä»€ä¹ˆæ˜¯å·¥ä½œé˜Ÿåˆ—ï¼Ÿ**
å°±åƒé“¶è¡Œæ’é˜Ÿå–å·ä¸€æ ·ï¼Œæœ‰ä¸€ä¸ªé˜Ÿåˆ—æ”¾ç€å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œå¤šä¸ªå·¥äººåŒæ—¶ä»é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ¥å¤„ç†ã€‚

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: work-queue-job
spec:
  parallelism: 3      # 3ä¸ªå·¥äººåŒæ—¶å·¥ä½œ
  # æ³¨æ„ï¼šæ²¡æœ‰è®¾ç½®completionsï¼Œè®©Podè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™å®Œæˆ
  template:
    spec:
      containers:
      - name: worker
        image: my-work-queue-app
        env:
        - name: QUEUE_URL
          value: "redis://queue-service:6379"
      restartPolicy: Never
```

**å·¥ä½œæ¨¡å¼å›¾è§£**ï¼š
```
é˜Ÿåˆ—æœåŠ¡å™¨                å·¥ä½œèŠ‚ç‚¹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»»åŠ¡é˜Ÿåˆ—    â”‚  <------> â”‚  Worker1 â”‚
â”‚ [Task1]     â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ [Task2]     â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Task3]     â”‚  <------> â”‚  Worker2 â”‚
â”‚ [Task4]     â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ [Task5]     â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  <------> â”‚  Worker3 â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ğŸ”§ ä»»åŠ¡å¤±è´¥é‡è¯•æœºåˆ¶


### 4.1 é‡è¯•ç­–ç•¥é…ç½®


**ğŸ”¸ backoffLimit**ï¼šæ§åˆ¶æœ€å¤§é‡è¯•æ¬¡æ•°

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: retry-job
spec:
  backoffLimit: 3  # æœ€å¤šé‡è¯•3æ¬¡
  template:
    spec:
      containers:
      - name: flaky-task
        image: busybox
        command: ['sh', '-c', '
          if [ $((RANDOM % 2)) -eq 0 ]; then
            echo "Task succeeded!"
            exit 0
          else
            echo "Task failed!"
            exit 1
          fi
        ']
      restartPolicy: Never
```

### 4.2 é‡è¯•æœºåˆ¶è¯¦è§£


**é‡è¯•è¿‡ç¨‹æ—¶é—´çº¿**ï¼š
```
å°è¯•æ¬¡æ•°          ç»“æœ         ä¸‹æ¬¡é‡è¯•å»¶è¿Ÿ
â”œâ”€ ç¬¬1æ¬¡ â”€â”€â”€â”€â”€â”€ å¤±è´¥ â”€â”€â”€â”€â”€â”€â”€ 10ç§’åé‡è¯•
â”œâ”€ ç¬¬2æ¬¡ â”€â”€â”€â”€â”€â”€ å¤±è´¥ â”€â”€â”€â”€â”€â”€â”€ 20ç§’åé‡è¯•  
â”œâ”€ ç¬¬3æ¬¡ â”€â”€â”€â”€â”€â”€ å¤±è´¥ â”€â”€â”€â”€â”€â”€â”€ 40ç§’åé‡è¯•
â””â”€ ç¬¬4æ¬¡ â”€â”€â”€â”€â”€â”€ å¤±è´¥ â”€â”€â”€â”€â”€â”€â”€ è¶…è¿‡é™åˆ¶ï¼ŒJobå¤±è´¥
```

**ğŸ”¸ é€€é¿å»¶è¿Ÿç®—æ³•**ï¼š
- ç¬¬1æ¬¡é‡è¯•ï¼š10ç§’
- ç¬¬2æ¬¡é‡è¯•ï¼š20ç§’
- ç¬¬3æ¬¡é‡è¯•ï¼š40ç§’
- æœ€å¤§å»¶è¿Ÿï¼š6åˆ†é’Ÿ

### 4.3 é‡å¯ç­–ç•¥å¯¹æ¯”


| é‡å¯ç­–ç•¥ | **Podå†…é‡å¯** | **åˆ›å»ºæ–°Pod** | **é€‚ç”¨åœºæ™¯** |
|---------|--------------|-------------|------------|
| `Never` | âŒ | âœ… | `éœ€è¦ä¿ç•™å¤±è´¥æ—¥å¿—` |
| `OnFailure` | âœ… | âŒ | `èŠ‚çœèµ„æºï¼Œå¿«é€Ÿé‡è¯•` |

**ä»£ç ç¤ºä¾‹å¯¹æ¯”**ï¼š

```yaml
# ç­–ç•¥1ï¼šNever - æ¯æ¬¡å¤±è´¥åˆ›å»ºæ–°Pod
spec:
  template:
    spec:
      restartPolicy: Never
      # å¤±è´¥åä¼šåˆ›å»ºå…¨æ–°çš„Podï¼Œä¹‹å‰çš„Podä¿ç•™ç”¨äºè°ƒè¯•

# ç­–ç•¥2ï¼šOnFailure - åœ¨åŒä¸€Podå†…é‡å¯å®¹å™¨
spec:
  template:
    spec:
      restartPolicy: OnFailure  
      # å¤±è´¥ååœ¨åŒä¸€Podå†…é‡å¯å®¹å™¨ï¼ŒèŠ‚çœèµ„æº
```

---

## 5. ğŸ§¹ ä»»åŠ¡æ¸…ç†ç­–ç•¥


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ¸…ç†ï¼Ÿ


**é—®é¢˜ç°è±¡**ï¼š
```bash
$ kubectl get pods
NAME                READY   STATUS      RESTARTS   AGE
hello-job-abc123    0/1     Completed   0          2h
hello-job-def456    0/1     Completed   0          4h  
hello-job-ghi789    0/1     Completed   0          6h
# å¤§é‡å·²å®Œæˆçš„Podå ç”¨èµ„æºï¼
```

### 5.2 TTLæ§åˆ¶å™¨è‡ªåŠ¨æ¸…ç†


**ğŸ”¸ ttlSecondsAfterFinished**ï¼šä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ¸…ç†

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: auto-cleanup-job
spec:
  ttlSecondsAfterFinished: 300  # å®Œæˆå5åˆ†é’Ÿè‡ªåŠ¨åˆ é™¤
  template:
    spec:
      containers:
      - name: worker
        image: busybox
        command: ['sh', '-c', 'echo "Task done" && sleep 10']
      restartPolicy: Never
```

**æ¸…ç†æ—¶é—´çº¿**ï¼š
```
Jobåˆ›å»º -> ä»»åŠ¡æ‰§è¡Œ -> ä»»åŠ¡å®Œæˆ -> ç­‰å¾…300ç§’ -> è‡ªåŠ¨åˆ é™¤Jobå’ŒPod
   0s        30s        40s         340s        ğŸ—‘ï¸ æ¸…ç†
```

### 5.3 æ‰‹åŠ¨æ¸…ç†ç­–ç•¥


```bash
# åˆ é™¤æ‰€æœ‰å·²å®Œæˆçš„Job
kubectl delete jobs --field-selector status.successful=1

# åˆ é™¤æ‰€æœ‰å·²å®Œæˆçš„Pod
kubectl delete pods --field-selector status.phase=Succeeded

# æ¸…ç†å¤±è´¥çš„Jobï¼ˆä¿ç•™æœ€è¿‘çš„3ä¸ªï¼‰
kubectl get jobs --sort-by=.metadata.creationTimestamp | \
head -n -3 | awk '{print $1}' | xargs kubectl delete job
```

### 5.4 æ¸…ç†ç­–ç•¥å¯¹æ¯”è¡¨


| æ¸…ç†æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **æ¨èåœºæ™¯** |
|---------|---------|---------|-------------|
| ğŸ¤– **è‡ªåŠ¨æ¸…ç†** | `æ— éœ€äººå·¥å¹²é¢„` | `æ—¥å¿—å¯èƒ½ä¸¢å¤±` | `å®šæœŸæ‰¹å¤„ç†ä»»åŠ¡` |
| ğŸ§¹ **æ‰‹åŠ¨æ¸…ç†** | `å¯æ§æ€§å¼º` | `éœ€è¦è®°ä½æ¸…ç†` | `é‡è¦ä»»åŠ¡ï¼Œéœ€ä¿ç•™æ—¥å¿—` |
| ğŸ“Š **å®šæœŸè„šæœ¬** | `çµæ´»é…ç½®` | `éœ€è¦ç»´æŠ¤è„šæœ¬` | `å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ` |

---

## 6. ğŸš€ æ‰¹å¤„ç†åº”ç”¨åœºæ™¯


### 6.1 æ•°æ®åº“å¤‡ä»½ä»»åŠ¡


**åœºæ™¯æè¿°**ï¼šæ¯å¤©å‡Œæ™¨å¤‡ä»½ç”Ÿäº§æ•°æ®åº“

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: db-backup-job
spec:
  schedule: "0 2 * * *"  # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
  template:
    spec:
      containers:
      - name: backup
        image: postgres:13
        env:
        - name: PGPASSWORD
          valueFrom:
            secretKeyRef:
              name: db-credentials
              key: password
        command: ['sh', '-c']
        args:
        - |
          pg_dump -h postgres-service -U admin mydb > /backup/backup-$(date +%Y%m%d).sql
          echo "Backup completed successfully"
        volumeMounts:
        - name: backup-storage
          mountPath: /backup
      volumes:
      - name: backup-storage
        persistentVolumeClaim:
          claimName: backup-pvc
      restartPolicy: OnFailure
```

### 6.2 å›¾ç‰‡å¤„ç†æ‰¹ä»»åŠ¡


**åœºæ™¯æè¿°**ï¼šæ‰¹é‡å‹ç¼©ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: image-processing-job
spec:
  parallelism: 5      # 5ä¸ªPodå¹¶è¡Œå¤„ç†
  completions: 100    # å¤„ç†100æ‰¹å›¾ç‰‡
  template:
    spec:
      containers:
      - name: image-processor
        image: my-image-processor:latest
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi" 
            cpu: "1000m"
        env:
        - name: INPUT_PATH
          value: "/input"
        - name: OUTPUT_PATH  
          value: "/output"
        volumeMounts:
        - name: images-volume
          mountPath: /input
        - name: processed-volume
          mountPath: /output
      volumes:
      - name: images-volume
        persistentVolumeClaim:
          claimName: images-pvc
      - name: processed-volume
        persistentVolumeClaim:
          claimName: processed-pvc
      restartPolicy: Never
```

### 6.3 æ—¥å¿—åˆ†æä»»åŠ¡


**åœºæ™¯æè¿°**ï¼šåˆ†ææ˜¨å¤©çš„è®¿é—®æ—¥å¿—ï¼Œç”ŸæˆæŠ¥è¡¨

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: log-analysis-job
spec:
  activeDeadlineSeconds: 3600  # 1å°æ—¶è¶…æ—¶
  template:
    spec:
      containers:
      - name: log-analyzer
        image: python:3.9
        command: ['python', '-c']
        args:
        - |
          import os
          from datetime import datetime, timedelta
          
          yesterday = (datetime.now() - timedelta(days=1)).strftime('%Y-%m-%d')
          log_file = f'/logs/access-{yesterday}.log'
          
          print(f"Analyzing log file: {log_file}")
          
          # ç®€åŒ–çš„æ—¥å¿—åˆ†æé€»è¾‘
          if os.path.exists(log_file):
              with open(log_file, 'r') as f:
                  lines = f.readlines()
              
              print(f"Total requests: {len(lines)}")
              print("Analysis completed successfully")
          else:
              print(f"Log file {log_file} not found")
              exit(1)
        volumeMounts:
        - name: logs-volume
          mountPath: /logs
      volumes:
      - name: logs-volume
        hostPath:
          path: /var/log/nginx
      restartPolicy: Never
```

### 6.4 å®é™…åº”ç”¨åœºæ™¯æ±‡æ€»


| åº”ç”¨ç±»å‹ | **ä»»åŠ¡ç‰¹ç‚¹** | **é…ç½®é‡ç‚¹** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|-------------|
| ğŸ“Š **æ•°æ®å¤‡ä»½** | `å®šæ—¶æ‰§è¡Œï¼Œå¿…é¡»æˆåŠŸ` | `è®¾ç½®é‡è¯•ï¼Œé•¿è¶…æ—¶æ—¶é—´` | `å­˜å‚¨å·é…ç½®ï¼Œæƒé™æ§åˆ¶` |
| ğŸ–¼ï¸ **åª’ä½“å¤„ç†** | `CPUå¯†é›†ï¼Œå¯å¹¶è¡Œ` | `é«˜å¹¶è¡Œåº¦ï¼Œèµ„æºé™åˆ¶` | `å†…å­˜ç®¡ç†ï¼Œä¸´æ—¶å­˜å‚¨` |
| ğŸ“ˆ **æŠ¥è¡¨ç”Ÿæˆ** | `æ—¶é—´æ•æ„Ÿï¼Œä¾èµ–æ•°æ®` | `è®¾ç½®ä¾èµ–ï¼Œé”™è¯¯å¤„ç†` | `æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥` |
| ğŸ§¹ **æ•°æ®æ¸…ç†** | `ä½ä¼˜å…ˆçº§ï¼Œé•¿æ—¶é—´` | `ä½èµ„æºè¦æ±‚ï¼Œå®¹é”™æ€§` | `é¿å¼€ä¸šåŠ¡é«˜å³°æœŸ` |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Jobæœ¬è´¨ï¼šä¸€æ¬¡æ€§ä»»åŠ¡æ‰§è¡Œå™¨ï¼Œå®Œæˆå³åœæ­¢
ğŸ”¸ å®Œæˆæ ‡å‡†ï¼šè¿›ç¨‹æ­£å¸¸é€€å‡º(é€€å‡ºç 0)ï¼Œå¯è®¾ç½®å®Œæˆæ¬¡æ•°
ğŸ”¸ å¹¶è¡Œæ§åˆ¶ï¼šparallelismæ§åˆ¶åŒæ—¶è¿è¡Œçš„Podæ•°é‡
ğŸ”¸ å¤±è´¥é‡è¯•ï¼šbackoffLimitè®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°
ğŸ”¸ è‡ªåŠ¨æ¸…ç†ï¼šttlSecondsAfterFinishedè®¾ç½®æ¸…ç†æ—¶é—´
ğŸ”¸ é€‚ç”¨åœºæ™¯ï¼šæ‰¹å¤„ç†ã€æ•°æ®å¤„ç†ã€å®šæ—¶ä»»åŠ¡
```

### 7.2 å…³é”®é…ç½®å‚æ•°


**ğŸ”¹ åŸºç¡€é…ç½®**
```yaml
spec:
  completions: 3              # éœ€è¦æˆåŠŸå®Œæˆçš„æ¬¡æ•°
  parallelism: 2              # å¹¶è¡Œæ‰§è¡Œçš„Podæ•°é‡
  activeDeadlineSeconds: 300  # ä»»åŠ¡æ€»è¶…æ—¶æ—¶é—´
  backoffLimit: 3             # æœ€å¤§é‡è¯•æ¬¡æ•°
  ttlSecondsAfterFinished: 100 # å®Œæˆåæ¸…ç†æ—¶é—´
```

**ğŸ”¹ Podæ¨¡æ¿é…ç½®**
```yaml
template:
  spec:
    restartPolicy: Never    # æˆ– OnFailureï¼Œä¸èƒ½æ˜¯Always
    containers:
    - name: task
      image: busybox
      command: ['sh', '-c', 'echo "Hello" && sleep 30']
```

### 7.3 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**
```
ğŸ¯ è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼šé¿å…ä»»åŠ¡æ— é™è¿è¡Œ
ğŸ”„ é…ç½®é€‚å½“çš„é‡è¯•æ¬¡æ•°ï¼šå¹³è¡¡å¯é æ€§ä¸èµ„æºæ¶ˆè€—
ğŸ§¹ å¯ç”¨è‡ªåŠ¨æ¸…ç†ï¼šé¿å…é›†ç¾¤èµ„æºæµªè´¹
ğŸ“Š ç›‘æ§ä»»åŠ¡çŠ¶æ€ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†å¼‚å¸¸
ğŸ” èµ„æºé™åˆ¶é…ç½®ï¼šé˜²æ­¢ä»»åŠ¡æ¶ˆè€—è¿‡å¤šèµ„æº
```

**âŒ é¿å…çš„é”™è¯¯**
```
ğŸš« ä¸è¦è®¾ç½®restartPolicyä¸ºAlways
ğŸš« ä¸è¦åœ¨Jobä¸­è¿è¡Œé•¿æœŸæœåŠ¡
ğŸš« ä¸è¦å¿˜è®°è®¾ç½®èµ„æºé™åˆ¶
ğŸš« ä¸è¦å¿½ç•¥å¤±è´¥æ—¥å¿—çš„æ”¶é›†
ğŸš« ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¿‡é«˜çš„å¹¶è¡Œåº¦
```

### 7.4 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥**

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|
| `Jobä¸€ç›´ä¸å®Œæˆ` | `è¿›ç¨‹æ²¡æœ‰æ­£å¸¸é€€å‡º` | `æ£€æŸ¥å‘½ä»¤è¿”å›å€¼ï¼Œç¡®ä¿exit 0` |
| `Podä¸æ–­é‡å¯` | `restartPolicyé…ç½®é”™è¯¯` | `è®¾ç½®ä¸ºNeveræˆ–OnFailure` |
| `ä»»åŠ¡æ‰§è¡Œå¤±è´¥` | `èµ„æºä¸è¶³æˆ–ä¾èµ–ç¼ºå¤±` | `å¢åŠ èµ„æºé™åˆ¶ï¼Œæ£€æŸ¥ä¾èµ–æœåŠ¡` |
| `æ¸…ç†ä¸åŠæ—¶` | `æ²¡æœ‰é…ç½®TTL` | `è®¾ç½®ttlSecondsAfterFinished` |

**ğŸ“± ç›‘æ§å‘½ä»¤**
```bash
# æŸ¥çœ‹JobçŠ¶æ€
kubectl get jobs

# æŸ¥çœ‹Jobè¯¦ç»†ä¿¡æ¯  
kubectl describe job <job-name>

# æŸ¥çœ‹Podæ—¥å¿—
kubectl logs -l job-name=<job-name>

# ç›‘æ§Jobæ‰§è¡Œè¿‡ç¨‹
kubectl get pods -w -l job-name=<job-name>
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Jobåƒä¸´æ—¶å·¥ï¼Œå®Œæˆä»»åŠ¡å°±èµ°äºº
- è®¾ç½®å¥½é‡è¯•æ¬¡æ•°ï¼Œä»»åŠ¡æ›´å¯é 
- å¹¶è¡Œæ‰§è¡Œææ•ˆç‡ï¼Œæ¸…ç†ç­–ç•¥å¾ˆé‡è¦
- æ‰¹å¤„ç†åœºæ™¯æ˜¯å¼ºé¡¹ï¼Œä¸€æ¬¡æ€§ä»»åŠ¡æ‰¾Job