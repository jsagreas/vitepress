---
title: 6、命名空间资源隔离
---
## 📚 目录

1. [命名空间基础概念](#1-命名空间基础概念)
2. [默认命名空间详解](#2-默认命名空间详解)
3. [命名空间操作实践](#3-命名空间操作实践)
4. [跨命名空间通信](#4-跨命名空间通信)
5. [资源作用域管理](#5-资源作用域管理)
6. [生命周期与最佳实践](#6-生命周期与最佳实践)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🏠 命名空间基础概念


### 1.1 什么是命名空间


**🔸 生活中的类比**
想象一个大型办公楼，里面有很多不同的公司。每个公司都有自己的办公区域、员工、设备，彼此相对独立。Kubernetes的命名空间（Namespace）就像这些办公区域一样，为不同的应用或团队提供**逻辑隔离**的工作空间。

**🔸 核心定义**
```
命名空间 = Kubernetes 集群内的虚拟分区
作用：将集群资源分割成多个独立的逻辑环境
目的：实现多租户、环境隔离、资源管理
```

**🔸 为什么需要命名空间**
- **🏢 多租户支持**：一个集群可以被多个团队共享使用
- **🔐 资源隔离**：不同环境的资源互不干扰
- **📊 资源配额**：可以对不同空间设置资源使用限制
- **🎯 权限管理**：精细化控制用户访问权限

### 1.2 命名空间的特点


**✅ 支持的特性**
```
逻辑隔离：   同名资源可在不同命名空间共存
资源配额：   限制CPU、内存、存储使用量
访问控制：   基于RBAC的权限管理
网络策略：   控制命名空间间的网络访问
```

**❌ 不支持的特性**
```
物理隔离：   底层还是共享同一个集群
完全隔离：   系统级资源仍然是共享的
嵌套结构：   命名空间不能包含子命名空间
跨集群：     命名空间只存在于单个集群内
```

### 1.3 命名空间架构图


```
┌─────────────────────── Kubernetes 集群 ───────────────────────┐
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │   default    │  │    kube-*    │  │   自定义空间   │        │
│  │              │  │              │  │              │        │
│  │  🏠 Pod-A    │  │  ⚙️ 系统组件   │  │  📱 前端应用   │        │
│  │  📦 Service-A │  │  📊 监控组件   │  │  💾 数据库     │        │
│  │  🔧 ConfigMap │  │  🌐 网络组件   │  │  🔒 Secret    │        │
│  └──────────────┘  └──────────────┘  └──────────────┘        │
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │  production  │  │   staging    │  │  development │        │
│  │              │  │              │  │              │        │
│  │  🚀 生产应用   │  │  🧪 测试应用   │  │  💻 开发应用   │        │
│  │  ⭐ 高可用配置  │  │  🔍 预发布版   │  │  🛠️ 调试工具   │        │
│  └──────────────┘  └──────────────┘  └──────────────┘        │
└───────────────────────────────────────────────────────────────┘
```

---

## 2. 🎯 默认命名空间详解


### 2.1 系统默认命名空间


Kubernetes集群创建后，会自动生成几个系统命名空间，每个都有特定的用途：

**🔸 default 命名空间**
```
用途：默认工作空间，用户创建资源的默认位置
特点：如果不指定命名空间，资源会自动放在这里
建议：生产环境中避免直接使用，应该创建专门的命名空间
```

**🔸 kube-system 命名空间**
```
用途：Kubernetes系统组件的专用空间
包含：API服务器、调度器、控制器管理器等核心组件
特点：系统关键组件，不要随意修改其中的资源
```

**🔸 kube-public 命名空间**
```
用途：存放所有用户都能访问的公共资源
特点：即使未认证的用户也能读取
用例：集群信息、公共配置等
```

**🔸 kube-node-lease 命名空间**
```
用途：存放节点心跳信息
作用：提高节点状态检查的性能
特点：Kubernetes 1.13+ 版本引入
```

### 2.2 查看默认命名空间


**🔧 查看所有命名空间**
```bash
# 列出所有命名空间
kubectl get namespaces
# 简写形式
kubectl get ns
```

**预期输出示例：**
```
NAME              STATUS   AGE
default           Active   7d
kube-node-lease   Active   7d
kube-public       Active   7d
kube-system       Active   7d
```

**🔍 查看特定命名空间详情**
```bash
# 查看default命名空间的详细信息
kubectl describe namespace default
```

### 2.3 默认命名空间的资源


**🔸 default空间常见资源**
- **Pod**：应用程序实例
- **Service**：服务发现和负载均衡
- **ConfigMap**：配置信息存储
- **Secret**：敏感信息存储

**🔸 kube-system空间核心组件**
- **etcd**：集群数据存储
- **kube-apiserver**：API网关
- **kube-controller-manager**：控制器管理
- **kube-scheduler**：任务调度器

---

## 3. 🛠️ 命名空间操作实践


### 3.1 创建命名空间


**🎯 方法一：命令行创建（快速）**
```bash
# 创建开发环境命名空间
kubectl create namespace development

# 创建生产环境命名空间
kubectl create namespace production
```

**🎯 方法二：YAML文件创建（推荐）**
```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: my-app
  labels:
    environment: development
    team: frontend
```

保存为`my-app-namespace.yaml`，然后执行：
```bash
kubectl apply -f my-app-namespace.yaml
```

### 3.2 在指定命名空间操作资源


**🔸 创建资源时指定命名空间**
```bash
# 在development命名空间创建Pod
kubectl run test-pod --image=nginx --namespace=development

# 使用-n简写
kubectl run test-pod --image=nginx -n development
```

**🔸 查看指定命名空间的资源**
```bash
# 查看development命名空间中的所有Pod
kubectl get pods -n development

# 查看所有命名空间中的Pod
kubectl get pods --all-namespaces
# 简写
kubectl get pods -A
```

### 3.3 设置默认命名空间


每次都输入`-n namespace`比较麻烦，可以设置默认命名空间：

```bash
# 设置当前上下文的默认命名空间
kubectl config set-context --current --namespace=development

# 验证设置是否生效
kubectl config view --minify | grep namespace:
```

设置后，所有kubectl命令都会默认在development命名空间执行。

### 3.4 命名空间管理实践


**🔸 批量创建多个环境**
```yaml
apiVersion: v1
kind: List
items:
- apiVersion: v1
  kind: Namespace
  metadata:
    name: development
    labels:
      environment: dev
- apiVersion: v1
  kind: Namespace
  metadata:
    name: staging  
    labels:
      environment: test
- apiVersion: v1
  kind: Namespace
  metadata:
    name: production
    labels:
      environment: prod
```

**🔸 删除命名空间**
```bash
# 删除指定命名空间（会同时删除其中所有资源）
kubectl delete namespace development

# ⚠️ 危险操作：删除命名空间会永久删除其中的所有资源！
```

---

## 4. 🌐 跨命名空间通信


### 4.1 服务发现机制


在Kubernetes中，不同命名空间的资源可以相互访问，但需要使用完整的域名格式。

**🔸 服务命名规则**
```
格式：<service-name>.<namespace>.svc.cluster.local

示例：
同命名空间访问：     mysql
跨命名空间访问：     mysql.database.svc.cluster.local
```

**🔸 通信示例场景**
```
场景：前端应用（frontend命名空间）需要访问数据库（database命名空间）

frontend命名空间中的Pod访问：
- 同空间服务： web-service
- 跨空间服务： mysql-service.database.svc.cluster.local
```

### 4.2 实际通信配置


**🎯 创建测试环境**

**Step 1: 创建两个命名空间**
```bash
kubectl create namespace frontend
kubectl create namespace backend
```

**Step 2: 在backend命名空间创建服务**
```yaml
# backend-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: api-service
  namespace: backend
spec:
  selector:
    app: api
  ports:
  - port: 8080
    targetPort: 8080
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-app
  namespace: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      labels:
        app: api
    spec:
      containers:
      - name: api
        image: nginx
        ports:
        - containerPort: 8080
```

**Step 3: frontend访问backend服务**
```bash
# 在frontend命名空间创建测试Pod
kubectl run test-pod --image=busybox -n frontend -- sleep 3600

# 进入Pod测试跨命名空间访问
kubectl exec -it test-pod -n frontend -- sh

# 在Pod内部测试连接（完整域名）
nslookup api-service.backend.svc.cluster.local
wget -qO- api-service.backend.svc.cluster.local:8080
```

### 4.3 网络策略控制


默认情况下，命名空间间可以自由通信。如果需要限制访问，可以使用网络策略：

```yaml
# 限制frontend只能访问backend的特定端口
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: backend-access-policy
  namespace: backend
spec:
  podSelector:
    matchLabels:
      app: api
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: frontend
    ports:
    - protocol: TCP
      port: 8080
```

---

## 5. 📊 资源作用域管理


### 5.1 命名空间级别资源


**🔸 受命名空间限制的资源**

这些资源必须属于某个特定的命名空间：

| 资源类型 | **用途说明** | **示例** |
|---------|------------|---------|
| 🏠 **Pod** | `应用实例` | `kubectl get pods -n development` |
| 📦 **Service** | `服务发现` | `kubectl get svc -n production` |
| 🔧 **ConfigMap** | `配置存储` | `kubectl get cm -n staging` |
| 🔒 **Secret** | `密钥存储` | `kubectl get secrets -n default` |
| 📋 **Deployment** | `应用部署` | `kubectl get deploy -A` |

### 5.2 集群级别资源


**🔸 不受命名空间限制的资源**

这些资源在整个集群中唯一，不属于任何命名空间：

| 资源类型 | **用途说明** | **特点** |
|---------|------------|---------|
| 🖥️ **Node** | `集群节点` | `全局唯一，集群基础设施` |
| 📁 **Namespace** | `命名空间本身` | `管理其他资源的容器` |
| 🔐 **ClusterRole** | `集群权限` | `跨命名空间的权限定义` |
| 💾 **StorageClass** | `存储类` | `定义存储提供商和参数` |
| 🌐 **IngressClass** | `入口控制器类` | `全局入口配置` |

### 5.3 查看资源作用域


**🔍 检查资源是否受命名空间限制**
```bash
# 查看所有API资源及其作用域
kubectl api-resources --namespaced=true   # 命名空间级别资源
kubectl api-resources --namespaced=false  # 集群级别资源
```

**🎯 实用查询示例**
```bash
# 查看某个命名空间的所有资源
kubectl get all -n development

# 查看集群中所有命名空间的Pod
kubectl get pods --all-namespaces

# 查看集群级别的节点信息
kubectl get nodes
```

---

## 6. 🔄 生命周期与最佳实践


### 6.1 命名空间生命周期


**🔸 创建阶段**
```
创建 → Active状态 → 开始接受资源
状态：Active
操作：可以正常创建和管理资源
```

**🔸 删除阶段**
```
删除请求 → Terminating状态 → 清理资源 → 完全移除
状态：Terminating
操作：停止接受新资源，清理现有资源
```

**⚠️ 重要提醒**
> 删除命名空间会**永久删除**其中的所有资源！这个操作不可逆，请务必谨慎。

### 6.2 命名空间最佳实践


**🎯 命名约定**
```
环境分离：   production, staging, development
功能分离：   frontend, backend, database
团队分离：   team-alpha, team-beta, team-gamma  
项目分离：   project-web, project-api, project-mobile
```

**🔸 推荐的组织结构**
```
生产级别：
├── production          # 生产环境
├── staging            # 预发布环境  
└── development        # 开发环境

功能模块：
├── frontend           # 前端应用
├── backend            # 后端服务
├── database           # 数据库相关
└── monitoring         # 监控组件

团队协作：
├── team-web           # Web开发团队
├── team-mobile        # 移动端团队
└── team-devops        # 运维团队
```

### 6.3 资源配额管理


**🔸 为命名空间设置资源限制**
```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: dev-quota
  namespace: development
spec:
  hard:
    requests.cpu: "4"        # CPU请求总和不超过4核
    requests.memory: 8Gi     # 内存请求总和不超过8GB
    limits.cpu: "8"          # CPU限制总和不超过8核  
    limits.memory: 16Gi      # 内存限制总和不超过16GB
    pods: "10"               # Pod数量不超过10个
    services: "5"            # Service数量不超过5个
```

**🔸 查看资源使用情况**
```bash
# 查看命名空间的资源配额
kubectl get quota -n development

# 查看资源使用详情
kubectl describe quota dev-quota -n development
```

### 6.4 权限管理实践


**🔐 为命名空间创建专用角色**
```yaml
# 创建只能在development命名空间操作的角色
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: development
  name: dev-role
rules:
- apiGroups: [""]
  resources: ["pods", "services", "configmaps"]
  verbs: ["get", "list", "create", "update", "delete"]
---
# 将角色绑定给用户
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: dev-binding
  namespace: development
subjects:
- kind: User
  name: developer
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: dev-role
  apiGroup: rbac.authorization.k8s.io
```

---

## 7. 📋 核心要点总结


### 7.1 命名空间核心概念回顾


**🔸 本质理解**
```
命名空间 = 集群内的虚拟分区
作用：   逻辑隔离，不是物理隔离
目的：   多租户支持，资源管理，权限控制
范围：   单个集群内，不能跨集群
```

### 7.2 关键知识点梳理


**🎯 必须掌握的核心要点**

1. **基础概念**
   - 命名空间提供逻辑隔离，不是物理隔离
   - 一个集群可以有多个命名空间，资源在其中相对独立
   - 系统默认创建4个命名空间，各有特定用途

2. **跨命名空间通信**
   - 使用完整域名：`<service>.<namespace>.svc.cluster.local`
   - 默认允许跨命名空间访问，可用网络策略限制
   - 同一命名空间内可以直接使用服务名

3. **资源作用域**
   - Pod、Service等属于命名空间级别资源
   - Node、StorageClass等属于集群级别资源
   - 命名空间本身也是集群级别资源

4. **操作实践**
   - 优先使用YAML文件创建，便于版本控制
   - 设置默认命名空间避免重复输入`-n`参数
   - 删除命名空间会删除其中所有资源

### 7.3 实际应用建议


**🚀 环境规划建议**
- **开发环境**：development - 开发人员日常使用
- **测试环境**：staging - 预发布测试验证
- **生产环境**：production - 正式对外服务

**🔧 日常操作技巧**
```bash
# 快速查看所有命名空间资源概况
kubectl get all --all-namespaces

# 设置别名简化常用命令
alias kgp='kubectl get pods'
alias kgs='kubectl get svc' 
alias kgns='kubectl get ns'
```

**⚠️ 注意事项**
- 删除命名空间前务必备份重要数据
- 生产环境避免使用default命名空间
- 定期检查和清理无用的命名空间
- 为不同环境设置合适的资源配额

### 7.4 学习检验清单


**📈 掌握程度自测**
- [ ] 能解释命名空间的作用和特点 (概念理解)
- [ ] 会创建和管理命名空间 (基础操作)
- [ ] 理解跨命名空间服务访问方式 (通信机制)
- [ ] 能区分命名空间级和集群级资源 (资源作用域)
- [ ] 会设置资源配额和权限控制 (高级管理)

**🎯 核心记忆要点**
- 命名空间是逻辑隔离，像办公楼里的不同公司区域
- 跨命名空间访问需要用完整的服务域名
- 删除命名空间会删除其中的所有资源，操作需谨慎
- 合理规划命名空间有助于团队协作和资源管理

---

**🧠 学习小贴士**：  
命名空间虽然概念简单，但在实际项目中合理使用能大大提升集群管理效率。建议在学习过程中多动手实践，体验不同命名空间间的资源隔离和通信机制。