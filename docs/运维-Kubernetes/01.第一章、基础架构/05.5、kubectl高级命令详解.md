---
title: 5ã€kubectlé«˜çº§å‘½ä»¤è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [kubectlé«˜çº§å‘½ä»¤æ¦‚è§ˆ](#1-kubectlé«˜çº§å‘½ä»¤æ¦‚è§ˆ)
2. [éƒ¨åˆ†æ›´æ–°å‘½ä»¤patchè¯¦è§£](#2-éƒ¨åˆ†æ›´æ–°å‘½ä»¤patchè¯¦è§£)
3. [åœ¨çº¿ç¼–è¾‘å‘½ä»¤editè¯¦è§£](#3-åœ¨çº¿ç¼–è¾‘å‘½ä»¤editè¯¦è§£)
4. [éƒ¨ç½²ç®¡ç†å‘½ä»¤rolloutè¯¦è§£](#4-éƒ¨ç½²ç®¡ç†å‘½ä»¤rolloutè¯¦è§£)
5. [æ‰©ç¼©å®¹å‘½ä»¤scaleè¯¦è§£](#5-æ‰©ç¼©å®¹å‘½ä»¤scaleè¯¦è§£)
6. [èµ„æºæ›¿æ¢å‘½ä»¤replaceè¯¦è§£](#6-èµ„æºæ›¿æ¢å‘½ä»¤replaceè¯¦è§£)
7. [çŠ¶æ€ç­‰å¾…å‘½ä»¤waitè¯¦è§£](#7-çŠ¶æ€ç­‰å¾…å‘½ä»¤waitè¯¦è§£)
8. [è¾“å‡ºæ ¼å¼åŒ–ä¸æŸ¥è¯¢æŠ€å·§](#8-è¾“å‡ºæ ¼å¼åŒ–ä¸æŸ¥è¯¢æŠ€å·§)
9. [æ‰¹é‡æ“ä½œæœ€ä½³å®è·µ](#9-æ‰¹é‡æ“ä½œæœ€ä½³å®è·µ)
10. [æƒé™æ§åˆ¶ä¸å®‰å…¨æ³¨æ„äº‹é¡¹](#10-æƒé™æ§åˆ¶ä¸å®‰å…¨æ³¨æ„äº‹é¡¹)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ kubectlé«˜çº§å‘½ä»¤æ¦‚è§ˆ


### 1.1 ä»€ä¹ˆæ˜¯kubectlé«˜çº§å‘½ä»¤


**ğŸ”¸ ç®€å•ç†è§£**
ä½ å¯ä»¥æŠŠkubectlæƒ³è±¡æˆKubernetesçš„"é¥æ§å™¨"ï¼Œè€Œé«˜çº§å‘½ä»¤å°±æ˜¯è¿™ä¸ªé¥æ§å™¨ä¸Šçš„"ä¸“ä¸šæŒ‰é’®"ã€‚åŸºç¡€å‘½ä»¤like `get`ã€`describe`æ˜¯æŸ¥çœ‹ä¿¡æ¯ï¼Œé«˜çº§å‘½ä»¤åˆ™æ˜¯**ç²¾ç»†åŒ–æ“ä½œ**ï¼Œè®©ä½ èƒ½æ›´çµæ´»åœ°ç®¡ç†é›†ç¾¤èµ„æºã€‚

**ğŸ“‹ æ ¸å¿ƒé«˜çº§å‘½ä»¤åˆ†ç±»**
```
èµ„æºä¿®æ”¹ç±»ï¼š
â”œâ”€â”€ patch     â†’ éƒ¨åˆ†æ›´æ–°ï¼ˆæ‰“è¡¥ä¸ï¼‰
â”œâ”€â”€ edit      â†’ åœ¨çº¿ç¼–è¾‘ï¼ˆå®æ—¶ä¿®æ”¹ï¼‰
â”œâ”€â”€ replace   â†’ æ•´ä½“æ›¿æ¢ï¼ˆå…¨éƒ¨é‡å†™ï¼‰

éƒ¨ç½²ç®¡ç†ç±»ï¼š
â”œâ”€â”€ rollout   â†’ éƒ¨ç½²ç®¡ç†ï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰
â”œâ”€â”€ scale     â†’ æ‰©ç¼©å®¹ï¼ˆè°ƒæ•´å‰¯æœ¬æ•°ï¼‰

çŠ¶æ€ç›‘æ§ç±»ï¼š
â”œâ”€â”€ wait      â†’ ç­‰å¾…çŠ¶æ€ï¼ˆç›‘æ§å˜åŒ–ï¼‰
â””â”€â”€ top       â†’ èµ„æºä½¿ç”¨æƒ…å†µ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é«˜çº§å‘½ä»¤


**ğŸ¯ è§£å†³çš„å®é™…é—®é¢˜**
- **ç²¾ç¡®ä¿®æ”¹**ï¼šåªæ”¹å˜èµ„æºçš„æŸä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯é‡å»ºæ•´ä¸ªèµ„æº
- **å®‰å…¨ç¼–è¾‘**ï¼šåœ¨çº¿ä¿®æ”¹é…ç½®ï¼Œé¿å…æ‰‹è¯¯åˆ é™¤èµ„æº
- **ç‰ˆæœ¬ç®¡ç†**ï¼šå›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œç®¡ç†éƒ¨ç½²å†å²
- **åŠ¨æ€è°ƒæ•´**ï¼šæ ¹æ®è´Ÿè½½æƒ…å†µå¿«é€Ÿæ‰©ç¼©å®¹
- **æ‰¹é‡æ“ä½œ**ï¼šä¸€æ¬¡æ€§æ“ä½œå¤šä¸ªèµ„æºï¼Œæé«˜æ•ˆç‡

**ğŸ’¡ ç±»æ¯”ç†è§£**
æƒ³è±¡ä½ åœ¨ç®¡ç†ä¸€å®¶é¤å…ï¼š
- `get` = æŸ¥çœ‹èœå•
- `patch` = ä¿®æ”¹æŸé“èœçš„ä»·æ ¼
- `edit` = é‡æ–°ç¼–è¾‘æ•´ä¸ªèœå•
- `scale` = å¢åŠ æˆ–å‡å°‘æœåŠ¡å‘˜æ•°é‡
- `rollout` = å›åˆ°æ˜¨å¤©çš„èœå•ç‰ˆæœ¬

---

## 2. ğŸ”§ éƒ¨åˆ†æ›´æ–°å‘½ä»¤patchè¯¦è§£


### 2.1 patchå‘½ä»¤åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯patch**
`patch`å°±åƒç»™è¡£æœæ‰“è¡¥ä¸ä¸€æ ·ï¼Œ**åªä¿®æ”¹èµ„æºçš„ç‰¹å®šéƒ¨åˆ†**ï¼Œè€Œä¸å½±å“å…¶ä»–é…ç½®ã€‚è¿™æ¯”é‡æ–°åˆ›å»ºæ•´ä¸ªèµ„æºè¦å®‰å…¨å’Œé«˜æ•ˆå¾—å¤šã€‚

**ğŸ“Š patchçš„ä¸‰ç§ç­–ç•¥**
```
ç­–ç•¥å¯¹æ¯”ï¼š

Strategic Mergeï¼ˆæˆ˜ç•¥åˆå¹¶ï¼‰ï¼š
â”œâ”€â”€ é»˜è®¤ç­–ç•¥ï¼Œæ™ºèƒ½åˆå¹¶
â”œâ”€â”€ é€‚ç”¨äºå¤§å¤šæ•°K8sèµ„æº
â””â”€â”€ è‡ªåŠ¨å¤„ç†æ•°ç»„å’Œå¯¹è±¡

JSON Mergeï¼ˆJSONåˆå¹¶ï¼‰ï¼š
â”œâ”€â”€ ç®€å•çš„JSONåˆå¹¶
â”œâ”€â”€ ç›´æ¥è¦†ç›–æŒ‡å®šå­—æ®µ
â””â”€â”€ é€‚ç”¨äºç®€å•ä¿®æ”¹

JSON Patchï¼ˆJSONè¡¥ä¸ï¼‰ï¼š
â”œâ”€â”€ RFC 6902æ ‡å‡†
â”œâ”€â”€ ç²¾ç¡®çš„æ“ä½œæŒ‡ä»¤
â””â”€â”€ é€‚ç”¨äºå¤æ‚ä¿®æ”¹
```

### 2.2 Strategic Merge Patchå®æˆ˜


**âš¡ ä¿®æ”¹å®¹å™¨é•œåƒ**
```bash
# æ›´æ–°Deploymentçš„é•œåƒç‰ˆæœ¬
kubectl patch deployment myapp --type='strategic' -p='
{
  "spec": {
    "template": {
      "spec": {
        "containers": [
          {
            "name": "myapp-container",
            "image": "nginx:1.20"
          }
        ]
      }
    }
  }
}'
```

**ğŸ”¸ é€šä¿—è§£é‡Š**ï¼šè¿™å°±åƒå‘Šè¯‰K8sï¼š"æˆ‘è¦æŠŠmyappè¿™ä¸ªåº”ç”¨çš„å®¹å™¨é•œåƒæ¢æˆnginx:1.20ç‰ˆæœ¬ï¼Œå…¶ä»–é…ç½®éƒ½ä¸å˜"

**âš¡ ä¿®æ”¹èµ„æºé™åˆ¶**
```bash
# è°ƒæ•´Podçš„CPUå’Œå†…å­˜é™åˆ¶
kubectl patch deployment myapp -p='
{
  "spec": {
    "template": {
      "spec": {
        "containers": [
          {
            "name": "myapp-container",
            "resources": {
              "limits": {
                "cpu": "500m",
                "memory": "1Gi"
              }
            }
          }
        ]
      }
    }
  }
}'
```

### 2.3 JSON Patché«˜çº§ç”¨æ³•


**âš¡ ä½¿ç”¨JSON Patchè¯­æ³•**
```bash
# æ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡
kubectl patch deployment myapp --type='json' -p='[
  {
    "op": "add",
    "path": "/spec/template/spec/containers/0/env/-",
    "value": {
      "name": "NEW_ENV",
      "value": "production"
    }
  }
]'

# åˆ é™¤æŒ‡å®šçš„ç¯å¢ƒå˜é‡
kubectl patch deployment myapp --type='json' -p='[
  {
    "op": "remove",
    "path": "/spec/template/spec/containers/0/env/0"
  }
]'
```

**ğŸ“ JSON Patchæ“ä½œç±»å‹**
| æ“ä½œ | è¯´æ˜ | ç¤ºä¾‹ç”¨é€” |
|------|------|----------|
| `add` | æ·»åŠ æ–°å­—æ®µæˆ–æ•°ç»„å…ƒç´  | æ·»åŠ ç¯å¢ƒå˜é‡ã€æ ‡ç­¾ |
| `remove` | åˆ é™¤æŒ‡å®šå­—æ®µ | ç§»é™¤é…ç½®é¡¹ |
| `replace` | æ›¿æ¢å­—æ®µå€¼ | æ›´æ–°é•œåƒç‰ˆæœ¬ |
| `move` | ç§»åŠ¨å­—æ®µä½ç½® | è°ƒæ•´é…ç½®é¡ºåº |
| `copy` | å¤åˆ¶å­—æ®µ | å¤åˆ¶é…ç½®æ¨¡æ¿ |
| `test` | æµ‹è¯•å­—æ®µå€¼ | æ¡ä»¶æ€§æ“ä½œ |

### 2.4 patchå‘½ä»¤å®ç”¨æŠ€å·§


**ğŸ¯ å¸¸ç”¨patchæ¨¡æ¿**
```bash
# å¿«é€Ÿä¿®æ”¹å‰¯æœ¬æ•°
kubectl patch deployment myapp -p='{"spec":{"replicas":3}}'

# æ·»åŠ èŠ‚ç‚¹é€‰æ‹©å™¨
kubectl patch deployment myapp -p='
{
  "spec": {
    "template": {
      "spec": {
        "nodeSelector": {
          "environment": "production"
        }
      }
    }
  }
}'

# ä¿®æ”¹Serviceç«¯å£
kubectl patch service myapp-service -p='
{
  "spec": {
    "ports": [
      {
        "port": 80,
        "targetPort": 8080,
        "protocol": "TCP"
      }
    ]
  }
}'
```

---

## 3. âœï¸ åœ¨çº¿ç¼–è¾‘å‘½ä»¤editè¯¦è§£


### 3.1 editå‘½ä»¤å·¥ä½œåŸç†


**ğŸ”¸ ä»€ä¹ˆæ˜¯edit**
`edit`å‘½ä»¤å°±åƒæ˜¯ç»™K8sèµ„æºæ‰“å¼€äº†ä¸€ä¸ª"è®°äº‹æœ¬"ï¼Œä½ å¯ä»¥ç›´æ¥ä¿®æ”¹èµ„æºçš„YAMLé…ç½®ï¼Œ**ä¿å­˜åç«‹å³ç”Ÿæ•ˆ**ã€‚è¿™æ˜¯æœ€ç›´è§‚çš„ç¼–è¾‘æ–¹å¼ã€‚

**ğŸ“‹ editçš„å·¥ä½œæµç¨‹**
```
ç”¨æˆ·æ‰§è¡Œkubectl edit
        â†“
K8sè·å–å½“å‰èµ„æºé…ç½®
        â†“
åœ¨é»˜è®¤ç¼–è¾‘å™¨ä¸­æ‰“å¼€YAML
        â†“
ç”¨æˆ·ä¿®æ”¹å¹¶ä¿å­˜
        â†“
K8séªŒè¯å¹¶åº”ç”¨æ›´æ”¹
        â†“
è¿”å›æ“ä½œç»“æœ
```

### 3.2 editå‘½ä»¤åŸºç¡€ç”¨æ³•


**âš¡ ç¼–è¾‘ä¸åŒç±»å‹çš„èµ„æº**
```bash
# ç¼–è¾‘Deployment
kubectl edit deployment myapp

# ç¼–è¾‘Service
kubectl edit service myapp-service

# ç¼–è¾‘ConfigMap
kubectl edit configmap myapp-config

# ç¼–è¾‘æŒ‡å®šå‘½åç©ºé—´çš„èµ„æº
kubectl edit deployment myapp -n production
```

**ğŸ”§ è®¾ç½®é»˜è®¤ç¼–è¾‘å™¨**
```bash
# è®¾ç½®vimä¸ºé»˜è®¤ç¼–è¾‘å™¨
export EDITOR=vim

# è®¾ç½®nanoä¸ºé»˜è®¤ç¼–è¾‘å™¨
export EDITOR=nano

# ä¸´æ—¶ä½¿ç”¨æŒ‡å®šç¼–è¾‘å™¨
EDITOR=vim kubectl edit deployment myapp
```

### 3.3 editå‘½ä»¤é«˜çº§æŠ€å·§


**ğŸ¯ ç¼–è¾‘æ—¶çš„å®‰å…¨æ£€æŸ¥**
```bash
# ç¼–è¾‘å‰å…ˆå¤‡ä»½å½“å‰é…ç½®
kubectl get deployment myapp -o yaml > myapp-backup.yaml

# ç¼–è¾‘èµ„æº
kubectl edit deployment myapp

# å¦‚æœå‡ºé”™ï¼Œå¯ä»¥ä»å¤‡ä»½æ¢å¤
kubectl apply -f myapp-backup.yaml
```

**âš ï¸ ç¼–è¾‘æ³¨æ„äº‹é¡¹**
- **ä¸å¯ä¿®æ”¹å­—æ®µ**ï¼šæŸäº›å­—æ®µï¼ˆå¦‚Podçš„é•œåƒï¼‰ä¿®æ”¹åä¼šè§¦å‘é‡æ–°åˆ›å»º
- **è¯­æ³•éªŒè¯**ï¼šä¿å­˜æ—¶K8sä¼šéªŒè¯YAMLè¯­æ³•ï¼Œé”™è¯¯æ—¶ä¼šæç¤ºé‡æ–°ç¼–è¾‘
- **å¹¶å‘ç¼–è¾‘**ï¼šå¤šäººåŒæ—¶ç¼–è¾‘å¯èƒ½å¯¼è‡´å†²çªï¼Œå»ºè®®åè°ƒæ“ä½œ

**ğŸ’¡ å¸¸è§ç¼–è¾‘åœºæ™¯**
```yaml
# ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼ˆåœ¨editä¸­ç›´æ¥ç¼–è¾‘ï¼‰
spec:
  template:
    spec:
      containers:
      - name: myapp
        env:
        - name: DATABASE_URL
          value: "mysql://new-db:3306/myapp"  # ä¿®æ”¹è¿™é‡Œ

# æ·»åŠ å­˜å‚¨å·
spec:
  template:
    spec:
      volumes:
      - name: app-storage
        persistentVolumeClaim:
          claimName: myapp-pvc  # æ·»åŠ æ–°çš„å­˜å‚¨å·
```

---

## 4. ğŸ”„ éƒ¨ç½²ç®¡ç†å‘½ä»¤rolloutè¯¦è§£


### 4.1 rolloutå‘½ä»¤æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯rollout**
`rollout`å°±åƒæ˜¯åº”ç”¨çš„"æ—¶å…‰æœº"ï¼Œå®ƒç®¡ç†ç€ä½ åº”ç”¨çš„**éƒ¨ç½²å†å²å’Œç‰ˆæœ¬æ§åˆ¶**ã€‚æƒ³è±¡ä½ åœ¨ç©æ¸¸æˆæ—¶çš„å­˜æ¡£åŠŸèƒ½ï¼Œrolloutè®©ä½ å¯ä»¥å›åˆ°ä¹‹å‰ä»»ä½•ä¸€ä¸ª"å­˜æ¡£ç‚¹"ã€‚

**ğŸ“Š rolloutç®¡ç†çš„èµ„æºç±»å‹**
```
æ”¯æŒrolloutçš„èµ„æºï¼š
â”œâ”€â”€ Deployment     â†’ æœ€å¸¸ç”¨ï¼Œç®¡ç†åº”ç”¨éƒ¨ç½²
â”œâ”€â”€ DaemonSet     â†’ ç®¡ç†èŠ‚ç‚¹ä¸Šçš„å®ˆæŠ¤è¿›ç¨‹
â”œâ”€â”€ StatefulSet   â†’ ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨
â””â”€â”€ ReplicaSet    â†’ ç®¡ç†å‰¯æœ¬é›†ï¼ˆé€šå¸¸é€šè¿‡Deploymentç®¡ç†ï¼‰
```

### 4.2 rolloutçŠ¶æ€ç®¡ç†


**âš¡ æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€**
```bash
# æŸ¥çœ‹Deploymentçš„rolloutçŠ¶æ€
kubectl rollout status deployment/myapp

# å®æ—¶ç›‘æ§éƒ¨ç½²è¿›åº¦
kubectl rollout status deployment/myapp --watch=true

# æŸ¥çœ‹rolloutå†å²
kubectl rollout history deployment/myapp
```

**ğŸ”¸ çŠ¶æ€è¯´æ˜**
- **Progressing**ï¼šæ­£åœ¨éƒ¨ç½²ä¸­
- **Complete**ï¼šéƒ¨ç½²æˆåŠŸå®Œæˆ
- **Failed**ï¼šéƒ¨ç½²å¤±è´¥
- **Paused**ï¼šéƒ¨ç½²å·²æš‚åœ

**ğŸ“‹ rolloutå†å²è®°å½•**
```bash
# æŸ¥çœ‹è¯¦ç»†å†å²ï¼ˆåŒ…æ‹¬åŸå› ï¼‰
kubectl rollout history deployment/myapp --revision=2

# è¾“å‡ºç¤ºä¾‹
deployment.apps/myapp 
REVISION  CHANGE-CAUSE
1         kubectl create --filename=deployment.yaml --record=true
2         kubectl set image deployment/myapp container=nginx:1.20
3         kubectl set image deployment/myapp container=nginx:1.21
```

### 4.3 ç‰ˆæœ¬å›æ»šæ“ä½œ


**âš¡ å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬**
```bash
# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/myapp

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
kubectl rollout undo deployment/myapp --to-revision=2

# æŸ¥çœ‹å›æ»šçŠ¶æ€
kubectl rollout status deployment/myapp
```

**ğŸ¯ å›æ»šæœ€ä½³å®è·µ**
```bash
# å›æ»šå‰å…ˆæš‚åœè‡ªåŠ¨éƒ¨ç½²
kubectl rollout pause deployment/myapp

# æ‰§è¡Œå›æ»š
kubectl rollout undo deployment/myapp --to-revision=1

# ç¡®è®¤å›æ»šæˆåŠŸåæ¢å¤
kubectl rollout resume deployment/myapp
```

### 4.4 éƒ¨ç½²æ§åˆ¶æŠ€å·§


**âš¡ æš‚åœå’Œæ¢å¤éƒ¨ç½²**
```bash
# æš‚åœéƒ¨ç½²ï¼ˆç”¨äºæ‰¹é‡ä¿®æ”¹ï¼‰
kubectl rollout pause deployment/myapp

# è¿›è¡Œå¤šä¸ªä¿®æ”¹
kubectl set image deployment/myapp container=nginx:1.20
kubectl patch deployment myapp -p='{"spec":{"replicas":5}}'

# æ¢å¤éƒ¨ç½²ï¼ˆä¸€æ¬¡æ€§åº”ç”¨æ‰€æœ‰ä¿®æ”¹ï¼‰
kubectl rollout resume deployment/myapp
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
- **ç°åº¦å‘å¸ƒ**ï¼šå…ˆæš‚åœéƒ¨ç½²ï¼Œä¿®æ”¹é…ç½®ï¼Œç„¶åé€æ­¥æ¢å¤
- **æ‰¹é‡ä¿®æ”¹**ï¼šé¿å…æ¯æ¬¡ä¿®æ”¹éƒ½è§¦å‘æ–°çš„éƒ¨ç½²
- **ç´§æ€¥å›æ»š**ï¼šå‘ç°é—®é¢˜æ—¶å¿«é€Ÿå›åˆ°ç¨³å®šç‰ˆæœ¬

---

## 5. ğŸ“ˆ æ‰©ç¼©å®¹å‘½ä»¤scaleè¯¦è§£


### 5.1 scaleå‘½ä»¤åŸºæœ¬åŸç†


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ‰©ç¼©å®¹**
`scale`å‘½ä»¤å°±åƒæ˜¯è°ƒèŠ‚æ°´é¾™å¤´çš„å¼€å…³ï¼Œæ§åˆ¶ç€ä½ åº”ç”¨çš„"æµé‡å¤§å°"ã€‚éœ€è¦å¤„ç†æ›´å¤šè¯·æ±‚æ—¶å°±**æ‰©å®¹**ï¼ˆå¢åŠ å‰¯æœ¬ï¼‰ï¼Œè´Ÿè½½è¾ƒä½æ—¶å°±**ç¼©å®¹**ï¼ˆå‡å°‘å‰¯æœ¬ï¼‰ã€‚

**ğŸ“Š å¯æ‰©ç¼©å®¹çš„èµ„æºç±»å‹**
```
æ”¯æŒscaleçš„èµ„æºï¼š
â”œâ”€â”€ Deployment        â†’ åº”ç”¨éƒ¨ç½²ï¼ˆæœ€å¸¸ç”¨ï¼‰
â”œâ”€â”€ ReplicaSet       â†’ å‰¯æœ¬é›†
â”œâ”€â”€ StatefulSet      â†’ æœ‰çŠ¶æ€åº”ç”¨
â”œâ”€â”€ DaemonSet        â†’ å®ˆæŠ¤è¿›ç¨‹ï¼ˆé€šå¸¸ä¸éœ€è¦scaleï¼‰
â””â”€â”€ ReplicationController â†’ æ—§ç‰ˆæœ¬æ§åˆ¶å™¨
```

### 5.2 åŸºæœ¬æ‰©ç¼©å®¹æ“ä½œ


**âš¡ ç®€å•æ‰©ç¼©å®¹å‘½ä»¤**
```bash
# æ‰©å®¹åˆ°5ä¸ªå‰¯æœ¬
kubectl scale deployment myapp --replicas=5

# ç¼©å®¹åˆ°1ä¸ªå‰¯æœ¬
kubectl scale deployment myapp --replicas=1

# æ‰©å®¹æŒ‡å®šå‘½åç©ºé—´çš„èµ„æº
kubectl scale deployment myapp --replicas=3 -n production

# æŸ¥çœ‹æ‰©ç¼©å®¹ç»“æœ
kubectl get pods -l app=myapp
```

**ğŸ”¸ æ‰©ç¼©å®¹è¿‡ç¨‹è§£æ**
```
æ‰©å®¹è¿‡ç¨‹ï¼ˆ1â†’3ä¸ªå‰¯æœ¬ï¼‰ï¼š
å½“å‰çŠ¶æ€: [Pod1]
æ‰§è¡Œæ‰©å®¹: kubectl scale --replicas=3
K8såˆ›å»º: [Pod1] [Pod2-Creating] [Pod3-Creating]
æœ€ç»ˆçŠ¶æ€: [Pod1] [Pod2-Running] [Pod3-Running]

ç¼©å®¹è¿‡ç¨‹ï¼ˆ3â†’1ä¸ªå‰¯æœ¬ï¼‰ï¼š
å½“å‰çŠ¶æ€: [Pod1] [Pod2] [Pod3]
æ‰§è¡Œç¼©å®¹: kubectl scale --replicas=1
K8såˆ é™¤: [Pod1] [Pod2-Terminating] [Pod3-Terminating]
æœ€ç»ˆçŠ¶æ€: [Pod1]
```

### 5.3 æ¡ä»¶æ‰©ç¼©å®¹


**âš¡ åŸºäºå½“å‰å‰¯æœ¬æ•°çš„æ¡ä»¶æ‰©ç¼©å®¹**
```bash
# åªæœ‰å½“å‰å‰¯æœ¬æ•°ä¸º2æ—¶æ‰æ‰©å®¹åˆ°5
kubectl scale deployment myapp --current-replicas=2 --replicas=5

# å¦‚æœå½“å‰ä¸æ˜¯2ä¸ªå‰¯æœ¬ï¼Œå‘½ä»¤ä¼šå¤±è´¥å¹¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
error: Expected replicas to be 2, was 3
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ¡ä»¶æ‰©ç¼©å®¹**
æƒ³è±¡ä½ å’ŒåŒäº‹éƒ½åœ¨ç®¡ç†åŒä¸€ä¸ªåº”ç”¨ï¼š
- ä½ ä»¥ä¸ºå½“å‰æ˜¯2ä¸ªå‰¯æœ¬ï¼Œæƒ³æ‰©å®¹åˆ°5ä¸ª
- ä½†åŒäº‹åˆšåˆšå·²ç»æ‰©å®¹åˆ°3ä¸ªäº†
- æ¡ä»¶æ‰©ç¼©å®¹å¯ä»¥é¿å…è¿™ç§å†²çªï¼Œç¡®ä¿æ“ä½œçš„å®‰å…¨æ€§

### 5.4 æ‰¹é‡æ‰©ç¼©å®¹æŠ€å·§


**âš¡ æ‰¹é‡æ“ä½œå¤šä¸ªèµ„æº**
```bash
# åŒæ—¶æ‰©ç¼©å®¹å¤šä¸ªDeployment
kubectl scale deployment myapp1 myapp2 myapp3 --replicas=3

# ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨æ‰¹é‡æ‰©ç¼©å®¹
kubectl scale deployment -l app=myapp --replicas=2

# æ‰©ç¼©å®¹æ•´ä¸ªå‘½åç©ºé—´çš„æ‰€æœ‰Deployment
kubectl scale deployment --all --replicas=1 -n development
```

**ğŸ¯ æ‰©ç¼©å®¹ç­–ç•¥è§„åˆ’**
```bash
# ç”Ÿäº§ç¯å¢ƒæ‰©å®¹ç­–ç•¥
kubectl scale deployment myapp --replicas=10    # é«˜å³°æœŸ
kubectl scale deployment myapp --replicas=3     # å¹³æ—¶
kubectl scale deployment myapp --replicas=1     # æ·±å¤œä½å³°

# å¼€å‘ç¯å¢ƒèµ„æºèŠ‚çº¦
kubectl scale deployment --all --replicas=0 -n dev-env  # ä¸‹ç­å…³é—­
kubectl scale deployment --all --replicas=1 -n dev-env  # ä¸Šç­å¯åŠ¨
```

---

## 6. ğŸ”„ èµ„æºæ›¿æ¢å‘½ä»¤replaceè¯¦è§£


### 6.1 replaceä¸å…¶ä»–å‘½ä»¤çš„åŒºåˆ«


**ğŸ”¸ replace vs apply vs patch**
```
å‘½ä»¤å¯¹æ¯”ç†è§£ï¼š

applyï¼ˆæ¨èï¼‰ï¼š
â”œâ”€â”€ å¦‚åŒ"æ™ºèƒ½æ›´æ–°"
â”œâ”€â”€ ä¼šå¯¹æ¯”å·®å¼‚ï¼Œåªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†
â”œâ”€â”€ åˆ›å»ºæˆ–æ›´æ–°ï¼Œè‡ªåŠ¨åˆ¤æ–­
â””â”€â”€ ç»´æŠ¤é…ç½®å†å²

replaceï¼ˆå¼ºåˆ¶æ›¿æ¢ï¼‰ï¼š
â”œâ”€â”€ å¦‚åŒ"å®Œå…¨é‡å†™"
â”œâ”€â”€ åˆ é™¤åŸèµ„æºï¼Œåˆ›å»ºæ–°èµ„æº
â”œâ”€â”€ èµ„æºå¿…é¡»å·²ç»å­˜åœ¨
â””â”€â”€ å¯èƒ½å¯¼è‡´æœåŠ¡ä¸­æ–­

patchï¼ˆéƒ¨åˆ†ä¿®æ”¹ï¼‰ï¼š
â”œâ”€â”€ å¦‚åŒ"å±€éƒ¨ä¿®è¡¥"
â”œâ”€â”€ åªä¿®æ”¹æŒ‡å®šçš„å­—æ®µ
â”œâ”€â”€ ä¸å½±å“å…¶ä»–é…ç½®
â””â”€â”€ æ“ä½œæ›´å®‰å…¨
```

### 6.2 replaceå‘½ä»¤åŸºæœ¬ç”¨æ³•


**âš¡ ä»æ–‡ä»¶æ›¿æ¢èµ„æº**
```bash
# ä»YAMLæ–‡ä»¶å®Œå…¨æ›¿æ¢èµ„æº
kubectl replace -f deployment.yaml

# å¼ºåˆ¶æ›¿æ¢ï¼ˆå³ä½¿èµ„æºç‰ˆæœ¬å†²çªï¼‰
kubectl replace -f deployment.yaml --force

# æ›¿æ¢å¤šä¸ªèµ„æºæ–‡ä»¶
kubectl replace -f deployment.yaml -f service.yaml

# æ›¿æ¢ç›®å½•ä¸‹æ‰€æœ‰YAMLæ–‡ä»¶
kubectl replace -f ./manifests/
```

**âš ï¸ replaceä½¿ç”¨æ³¨æ„äº‹é¡¹**
- **å¿…é¡»å­˜åœ¨**ï¼šèµ„æºå¿…é¡»å·²ç»å­˜åœ¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™
- **å®Œå…¨æ›¿æ¢**ï¼šä¼šåˆ é™¤åŸèµ„æºçš„æ‰€æœ‰é…ç½®ï¼ŒåŒ…æ‹¬ä½ æ²¡æœ‰åœ¨æ–‡ä»¶ä¸­æŒ‡å®šçš„å­—æ®µ
- **æœåŠ¡ä¸­æ–­**ï¼šå¯¹äºæŸäº›èµ„æºç±»å‹ï¼Œreplaceå¯èƒ½å¯¼è‡´çŸ­æš‚çš„æœåŠ¡ä¸­æ–­

### 6.3 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨replace


**âœ… é€‚åˆä½¿ç”¨replaceçš„åœºæ™¯**
```bash
# 1. é…ç½®æ–‡ä»¶æœ‰é‡å¤§ç»“æ„å˜åŒ–
# åŸé…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 3

# æ–°é…ç½®ï¼ˆå¢åŠ äº†å¤æ‚çš„é…ç½®ï¼‰
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 5
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨replaceæ›´æ¸…æ™°
kubectl replace -f new-deployment.yaml
```

**âŒ ä¸å»ºè®®ä½¿ç”¨replaceçš„åœºæ™¯**
- åªæ˜¯ä¿®æ”¹å‰¯æœ¬æ•°ã€é•œåƒç‰ˆæœ¬ç­‰ç®€å•å˜æ›´
- ç”Ÿäº§ç¯å¢ƒçš„å…³é”®æœåŠ¡ï¼ˆé¿å…æœåŠ¡ä¸­æ–­ï¼‰
- ä¸ç¡®å®šå½“å‰èµ„æºé…ç½®çŠ¶æ€æ—¶

### 6.4 replaceçš„å®‰å…¨å®è·µ


**ğŸ›¡ï¸ å®‰å…¨ä½¿ç”¨replaceçš„æ­¥éª¤**
```bash
# 1. å¤‡ä»½å½“å‰é…ç½®
kubectl get deployment myapp -o yaml > myapp-backup.yaml

# 2. éªŒè¯æ–°é…ç½®æ–‡ä»¶
kubectl apply --dry-run=client -f new-deployment.yaml

# 3. æ‰§è¡Œæ›¿æ¢
kubectl replace -f new-deployment.yaml

# 4. éªŒè¯æ›¿æ¢ç»“æœ
kubectl get deployment myapp
kubectl describe deployment myapp

# 5. å¦‚æœå‡ºé—®é¢˜ï¼Œä»å¤‡ä»½æ¢å¤
kubectl replace -f myapp-backup.yaml
```

---

## 7. â° çŠ¶æ€ç­‰å¾…å‘½ä»¤waitè¯¦è§£


### 7.1 waitå‘½ä»¤çš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦wait**
`wait`å‘½ä»¤å°±åƒæ˜¯ç»™K8sæ“ä½œåŠ ä¸Šäº†"ç­‰çº¢ç»¿ç¯"çš„åŠŸèƒ½ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ‰§è¡Œå®Œä¸€ä¸ªæ“ä½œåï¼Œéœ€è¦**ç­‰å¾…èµ„æºè¾¾åˆ°æœŸæœ›çŠ¶æ€**æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œwaitå‘½ä»¤è®©è¿™ä¸ªè¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
```
éƒ¨ç½²è„šæœ¬ä¸­çš„å…¸å‹åœºæ™¯ï¼š

1. åˆ›å»ºæ•°æ®åº“Pod
2. ç­‰å¾…æ•°æ®åº“Podè¿è¡Œæ­£å¸¸
3. å†åˆ›å»ºåº”ç”¨Podè¿æ¥æ•°æ®åº“

æ²¡æœ‰waitï¼šéœ€è¦æ‰‹åŠ¨æ£€æŸ¥ï¼Œå®¹æ˜“å‡ºé”™
æœ‰äº†waitï¼šè‡ªåŠ¨ç­‰å¾…ï¼Œè„šæœ¬æ›´å¯é 
```

### 7.2 waitå‘½ä»¤åŸºæœ¬è¯­æ³•


**âš¡ ç­‰å¾…PodçŠ¶æ€**
```bash
# ç­‰å¾…Podè¿›å…¥RunningçŠ¶æ€
kubectl wait --for=condition=Ready pod/myapp-pod --timeout=300s

# ç­‰å¾…æ‰€æœ‰åŒ¹é…æ ‡ç­¾çš„Podéƒ½Ready
kubectl wait --for=condition=Ready pods -l app=myapp --timeout=600s

# ç­‰å¾…Podè¢«åˆ é™¤å®Œæˆ
kubectl wait --for=delete pod/myapp-pod --timeout=60s
```

**ğŸ“Š å¸¸ç”¨çš„ç­‰å¾…æ¡ä»¶**
| æ¡ä»¶ç±»å‹ | è¯´æ˜ | é€‚ç”¨èµ„æº |
|---------|------|----------|
| `condition=Ready` | èµ„æºå‡†å¤‡å°±ç»ª | Pod, Node |
| `condition=Available` | èµ„æºå¯ç”¨ | Deployment |
| `condition=Complete` | ä»»åŠ¡å®Œæˆ | Job |
| `delete` | èµ„æºè¢«åˆ é™¤ | æ‰€æœ‰èµ„æº |
| `jsonpath='{.status.phase}'=Running` | ç‰¹å®šçŠ¶æ€å€¼ | è‡ªå®šä¹‰ |

### 7.3 ç­‰å¾…ä¸åŒèµ„æºç±»å‹


**âš¡ ç­‰å¾…Deploymentå°±ç»ª**
```bash
# ç­‰å¾…Deploymentçš„æ‰€æœ‰å‰¯æœ¬éƒ½å¯ç”¨
kubectl wait --for=condition=Available deployment/myapp --timeout=300s

# ç­‰å¾…Deploymentæ‰©ç¼©å®¹å®Œæˆ
kubectl scale deployment myapp --replicas=5
kubectl wait --for=condition=Available deployment/myapp --timeout=300s
```

**âš¡ ç­‰å¾…Jobå®Œæˆ**
```bash
# ç­‰å¾…æ‰¹å¤„ç†ä»»åŠ¡å®Œæˆ
kubectl wait --for=condition=Complete job/data-migration --timeout=1800s

# ç­‰å¾…CronJobçš„æŸæ¬¡æ‰§è¡Œå®Œæˆ
kubectl wait --for=condition=Complete job -l job-name=backup-job --timeout=600s
```

**âš¡ ç­‰å¾…è‡ªå®šä¹‰æ¡ä»¶**
```bash
# ä½¿ç”¨JSONPathç­‰å¾…ç‰¹å®šçŠ¶æ€
kubectl wait --for=jsonpath='{.status.phase}'=Running pod/myapp-pod

# ç­‰å¾…Serviceè·å¾—å¤–éƒ¨IP
kubectl wait --for=jsonpath='{.status.loadBalancer.ingress[0].ip}' service/myapp-service --timeout=300s
```

### 7.4 waitåœ¨è‡ªåŠ¨åŒ–è„šæœ¬ä¸­çš„åº”ç”¨


**ğŸš€ å®Œæ•´çš„éƒ¨ç½²è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash

echo "éƒ¨ç½²æ•°æ®åº“..."
kubectl apply -f database.yaml

echo "ç­‰å¾…æ•°æ®åº“Podå°±ç»ª..."
kubectl wait --for=condition=Ready pod -l app=database --timeout=300s

if [ $? -eq 0 ]; then
    echo "æ•°æ®åº“å·²å°±ç»ªï¼Œéƒ¨ç½²åº”ç”¨..."
    kubectl apply -f application.yaml
    
    echo "ç­‰å¾…åº”ç”¨éƒ¨ç½²å®Œæˆ..."
    kubectl wait --for=condition=Available deployment/myapp --timeout=300s
    
    if [ $? -eq 0 ]; then
        echo "éƒ¨ç½²æˆåŠŸå®Œæˆï¼"
        kubectl get pods -l app=myapp
    else
        echo "åº”ç”¨éƒ¨ç½²è¶…æ—¶ï¼"
        exit 1
    fi
else
    echo "æ•°æ®åº“å¯åŠ¨å¤±è´¥ï¼"
    exit 1
fi
```

**ğŸ’¡ è¶…æ—¶å¤„ç†æŠ€å·§**
```bash
# è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
kubectl wait --for=condition=Ready pod/large-app --timeout=600s  # å¤§å‹åº”ç”¨éœ€è¦æ›´é•¿æ—¶é—´

# ç»“åˆå¾ªç¯æ£€æŸ¥
for i in {1..10}; do
    kubectl wait --for=condition=Ready pod/myapp-pod --timeout=30s && break
    echo "ç­‰å¾…ä¸­... ($i/10)"
    sleep 10
done
```

---

## 8. ğŸ“Š è¾“å‡ºæ ¼å¼åŒ–ä¸æŸ¥è¯¢æŠ€å·§


### 8.1 è¾“å‡ºæ ¼å¼ç±»å‹


**ğŸ”¸ K8sæ”¯æŒçš„è¾“å‡ºæ ¼å¼**
```bash
# YAMLæ ¼å¼ï¼ˆå®Œæ•´é…ç½®ï¼‰
kubectl get pod myapp-pod -o yaml

# JSONæ ¼å¼ï¼ˆé€‚åˆç¨‹åºå¤„ç†ï¼‰
kubectl get pod myapp-pod -o json

# å®½æ ¼å¼ï¼ˆæ›´å¤šä¿¡æ¯ï¼‰
kubectl get pods -o wide

# è‡ªå®šä¹‰åˆ—æ ¼å¼
kubectl get pods -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName

# è¡¨æ ¼æ ¼å¼ï¼ˆé»˜è®¤ï¼‰
kubectl get pods
```

**ğŸ“‹ æ ¼å¼é€‰æ‹©æŒ‡å—**
| æ ¼å¼ | ç”¨é€” | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| `yaml` | äººç±»é˜…è¯»ï¼Œé…ç½®å¤‡ä»½ | å¯è¯»æ€§å¼ºï¼Œå®Œæ•´ä¿¡æ¯ | è¾“å‡ºè¾ƒé•¿ |
| `json` | ç¨‹åºå¤„ç†ï¼ŒAPIè°ƒç”¨ | ç»“æ„åŒ–ï¼Œæ˜“è§£æ | äººç±»é˜…è¯»å›°éš¾ |
| `wide` | å¿«é€ŸæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ | ä¿¡æ¯ä¸°å¯Œï¼Œæ ¼å¼æ•´é½ | åˆ—è¾ƒå¤šæ—¶æ¢è¡Œ |
| `custom-columns` | å®šåˆ¶åŒ–æ˜¾ç¤º | æŒ‰éœ€æ˜¾ç¤ºï¼Œç®€æ´ | éœ€è¦äº†è§£å­—æ®µè·¯å¾„ |

### 8.2 JSONPathæŸ¥è¯¢è¯­æ³•


**âš¡ JSONPathåŸºç¡€è¯­æ³•**
```bash
# è·å–Podçš„IPåœ°å€
kubectl get pod myapp-pod -o jsonpath='{.status.podIP}'

# è·å–æ‰€æœ‰Podçš„åç§°å’ŒçŠ¶æ€
kubectl get pods -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.status.phase}{"\n"}{end}'

# è·å–Nodeçš„å¯ç”¨èµ„æº
kubectl get nodes -o jsonpath='{.items[*].status.allocatable.cpu}'

# å¤æ‚æŸ¥è¯¢ï¼šè·å–æ‰€æœ‰å®¹å™¨çš„é•œåƒ
kubectl get pods -o jsonpath='{range .items[*]}{.metadata.name}{": "}{range .spec.containers[*]}{.image}{" "}{end}{"\n"}{end}'
```

**ğŸ“ JSONPathè¯­æ³•è¦ç‚¹**
```
åŸºç¡€è¯­æ³•ï¼š
â”œâ”€â”€ .               â†’ æ ¹å¯¹è±¡
â”œâ”€â”€ .field          â†’ è®¿é—®å­—æ®µ
â”œâ”€â”€ [index]         â†’ æ•°ç»„ç´¢å¼•
â”œâ”€â”€ [*]             â†’ æ‰€æœ‰æ•°ç»„å…ƒç´ 
â”œâ”€â”€ {range .items[*]} â†’ å¾ªç¯éå†
â””â”€â”€ {end}           â†’ ç»“æŸå¾ªç¯

å¸¸ç”¨å­—æ®µè·¯å¾„ï¼š
â”œâ”€â”€ .metadata.name     â†’ èµ„æºåç§°
â”œâ”€â”€ .metadata.labels   â†’ æ ‡ç­¾
â”œâ”€â”€ .spec             â†’ è§„æ ¼é…ç½®
â”œâ”€â”€ .status           â†’ å½“å‰çŠ¶æ€
â””â”€â”€ .items[*]         â†’ åˆ—è¡¨ä¸­çš„æ‰€æœ‰é¡¹
```

### 8.3 å®ç”¨æŸ¥è¯¢ç¤ºä¾‹


**ğŸ¯ èµ„æºç›‘æ§æŸ¥è¯¢**
```bash
# æŸ¥çœ‹Podèµ„æºä½¿ç”¨æƒ…å†µ
kubectl top pods --sort-by=cpu

# æŸ¥çœ‹æ‰€æœ‰Podçš„é‡å¯æ¬¡æ•°
kubectl get pods -o custom-columns=NAME:.metadata.name,RESTARTS:.status.containerStatuses[0].restartCount

# æŸ¥çœ‹å¤±è´¥çš„Pod
kubectl get pods --field-selector=status.phase=Failed

# æŸ¥çœ‹æŒ‡å®šNodeä¸Šçš„Pod
kubectl get pods --all-namespaces --field-selector=spec.nodeName=worker-node-1
```

**ğŸ” æ•…éšœæ’æŸ¥æŸ¥è¯¢**
```bash
# æŸ¥çœ‹Podçš„äº‹ä»¶
kubectl get events --field-selector=involvedObject.name=myapp-pod

# æŸ¥çœ‹æœ€è¿‘åˆ›å»ºçš„èµ„æº
kubectl get pods --sort-by=.metadata.creationTimestamp

# æŸ¥çœ‹å®¹å™¨çš„é€€å‡ºç 
kubectl get pods -o jsonpath='{range .items[*]}{.metadata.name}{": "}{.status.containerStatuses[0].lastState.terminated.exitCode}{"\n"}{end}'
```

### 8.4 è¾“å‡ºæ ¼å¼åŒ–æœ€ä½³å®è·µ


**ğŸ› ï¸ è‡ªå®šä¹‰ä¾¿æ·å‡½æ•°**
```bash
# åœ¨.bashrcä¸­æ·»åŠ æœ‰ç”¨çš„åˆ«å
alias kgp='kubectl get pods -o wide'
alias kgs='kubectl get services -o wide' 
alias kgn='kubectl get nodes -o wide'

# æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯çš„å‡½æ•°
function kpod() {
    kubectl get pod $1 -o custom-columns=\
NAME:.metadata.name,\
STATUS:.status.phase,\
IP:.status.podIP,\
NODE:.spec.nodeName,\
IMAGE:.spec.containers[0].image
}

# ä½¿ç”¨ç¤ºä¾‹
kpod myapp-pod
```

**ğŸ“Š åˆ›å»ºç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# pods-monitor.sh

echo "=== PodçŠ¶æ€æ¦‚è§ˆ ==="
kubectl get pods -o custom-columns=\
NAME:.metadata.name,\
STATUS:.status.phase,\
RESTARTS:.status.containerStatuses[0].restartCount,\
AGE:.metadata.creationTimestamp

echo ""
echo "=== èµ„æºä½¿ç”¨TOP 5 ==="
kubectl top pods --sort-by=cpu | head -6

echo ""
echo "=== é—®é¢˜Pod ==="
kubectl get pods --field-selector=status.phase!=Running
```

---

## 9. ğŸ“¦ æ‰¹é‡æ“ä½œæœ€ä½³å®è·µ


### 9.1 æ ‡ç­¾é€‰æ‹©å™¨çš„å¦™ç”¨


**ğŸ”¸ ç†è§£æ ‡ç­¾é€‰æ‹©å™¨**
æ ‡ç­¾é€‰æ‹©å™¨å°±åƒæ˜¯ç»™èµ„æºè´´ä¸Šäº†"åˆ†ç±»æ ‡ç­¾"ï¼Œä½ å¯ä»¥é€šè¿‡è¿™äº›æ ‡ç­¾**æ‰¹é‡æ“ä½œä¸€ç»„ç›¸å…³çš„èµ„æº**ã€‚è¿™æ¯”ä¸€ä¸ªä¸€ä¸ªæ“ä½œè¦é«˜æ•ˆå¾—å¤šã€‚

**âš¡ åŸºäºæ ‡ç­¾çš„æ‰¹é‡æ“ä½œ**
```bash
# é‡å¯æ‰€æœ‰å‰ç«¯æœåŠ¡çš„Pod
kubectl delete pods -l tier=frontend

# æ‰©å®¹æ‰€æœ‰å¾®æœåŠ¡
kubectl scale deployment -l type=microservice --replicas=3

# æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒçš„æ‰€æœ‰èµ„æº
kubectl get all -l environment=production

# æ‰¹é‡ä¿®æ”¹æ ‡ç­¾
kubectl label pods -l app=myapp version=v2.0
```

**ğŸ“‹ æ ‡ç­¾è®¾è®¡æœ€ä½³å®è·µ**
```yaml
# æ¨èçš„æ ‡ç­¾ç»“æ„
metadata:
  labels:
    app: myapp                    # åº”ç”¨åç§°
    version: v1.2.0              # ç‰ˆæœ¬å·
    component: frontend          # ç»„ä»¶ç±»å‹
    environment: production      # ç¯å¢ƒ
    tier: web                    # å±‚çº§
    team: platform              # è´Ÿè´£å›¢é˜Ÿ
```

### 9.2 å‘½åç©ºé—´çº§åˆ«çš„æ‰¹é‡æ“ä½œ


**âš¡ è·¨å‘½åç©ºé—´æ‰¹é‡æ“ä½œ**
```bash
# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´çš„Pod
kubectl get pods --all-namespaces

# åˆ é™¤æµ‹è¯•å‘½åç©ºé—´çš„æ‰€æœ‰Deployment
kubectl delete deployments --all -n test-env

# æ‰¹é‡æ‰©å®¹å¼€å‘ç¯å¢ƒæ‰€æœ‰åº”ç”¨
kubectl scale deployment --all --replicas=1 -n development

# æŸ¥çœ‹å¤šä¸ªå‘½åç©ºé—´çš„èµ„æº
kubectl get pods -n prod,staging,dev
```

**ğŸ¯ ç¯å¢ƒç®¡ç†ç­–ç•¥**
```bash
# ä¸‹ç­åå…³é—­å¼€å‘ç¯å¢ƒï¼ˆèŠ‚çœèµ„æºï¼‰
#!/bin/bash
NAMESPACES="dev-team1 dev-team2 dev-team3"

echo "å…³é—­å¼€å‘ç¯å¢ƒ..."
for ns in $NAMESPACES; do
    echo "å¤„ç†å‘½åç©ºé—´: $ns"
    kubectl scale deployment --all --replicas=0 -n $ns
done

# ä¸Šç­æ—¶å¯åŠ¨å¼€å‘ç¯å¢ƒ
echo "å¯åŠ¨å¼€å‘ç¯å¢ƒ..."
for ns in $NAMESPACES; do
    echo "å¤„ç†å‘½åç©ºé—´: $ns"
    kubectl scale deployment --all --replicas=1 -n $ns
done
```

### 9.3 æ–‡ä»¶æ‰¹é‡æ“ä½œ


**âš¡ æ‰¹é‡åº”ç”¨é…ç½®æ–‡ä»¶**
```bash
# åº”ç”¨ç›®å½•ä¸‹æ‰€æœ‰YAMLæ–‡ä»¶
kubectl apply -f ./manifests/

# åº”ç”¨å¤šä¸ªç‰¹å®šæ–‡ä»¶
kubectl apply -f deployment.yaml -f service.yaml -f configmap.yaml

# é€’å½’åº”ç”¨æ‰€æœ‰å­ç›®å½•çš„æ–‡ä»¶
kubectl apply -R -f ./k8s-configs/

# ä»URLåº”ç”¨é…ç½®
kubectl apply -f https://raw.githubusercontent.com/example/configs/main/app.yaml
```

**ğŸ—‚ï¸ é…ç½®æ–‡ä»¶ç»„ç»‡ç»“æ„**
```
é¡¹ç›®ç›®å½•ç»“æ„ï¼š
k8s-configs/
â”œâ”€â”€ base/                    # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ configmap.yaml
â”œâ”€â”€ environments/            # ç¯å¢ƒç‰¹å®šé…ç½®
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â””â”€â”€ dev-values.yaml
â”‚   â”œâ”€â”€ staging/
â”‚   â””â”€â”€ production/
â””â”€â”€ scripts/                 # éƒ¨ç½²è„šæœ¬
    â”œâ”€â”€ deploy.sh
    â””â”€â”€ rollback.sh
```

### 9.4 å®‰å…¨çš„æ‰¹é‡æ“ä½œ


**ğŸ›¡ï¸ æ‰¹é‡æ“ä½œå®‰å…¨æ£€æŸ¥**
```bash
# ä½¿ç”¨--dry-runé¢„è§ˆæ“ä½œç»“æœ
kubectl delete pods -l app=myapp --dry-run=client

# ä½¿ç”¨--selectorç¡®ä¿é€‰æ‹©æ­£ç¡®çš„èµ„æº
kubectl get pods --selector=app=myapp,environment=test

# åœ¨æ“ä½œå‰ç¡®è®¤é€‰æ‹©çš„èµ„æº
kubectl get pods -l app=myapp
read -p "ç¡®è®¤åˆ é™¤ä»¥ä¸ŠPodå—? (y/N): " confirm
if [[ $confirm == [yY] ]]; then
    kubectl delete pods -l app=myapp
fi
```

**âš ï¸ æ‰¹é‡æ“ä½œæ³¨æ„äº‹é¡¹**
- **æµ‹è¯•ç¯å¢ƒå…ˆè¯•**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒæ‰¹é‡æ“ä½œå‰ï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
- **å¤‡ä»½é‡è¦é…ç½®**ï¼šæ‰¹é‡ä¿®æ”¹å‰å¤‡ä»½å½“å‰é…ç½®
- **åˆ†æ‰¹æ‰§è¡Œ**ï¼šå¯¹äºå¤§è§„æ¨¡æ“ä½œï¼Œåˆ†æ‰¹æ‰§è¡Œå‡å°‘å½±å“
- **ç›‘æ§æ“ä½œç»“æœ**ï¼šæ‰¹é‡æ“ä½œååŠæ—¶æ£€æŸ¥ç»“æœ

**ğŸ“Š æ‰¹é‡æ“ä½œç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# batch-monitor.sh

echo "=== æ‰¹é‡æ“ä½œå‰çŠ¶æ€ ==="
kubectl get pods -l app=myapp -o wide

echo "æ‰§è¡Œæ‰¹é‡æ‰©å®¹..."
kubectl scale deployment -l app=myapp --replicas=5

echo "ç­‰å¾…æ‰©å®¹å®Œæˆ..."
kubectl wait --for=condition=Available deployment -l app=myapp --timeout=300s

echo "=== æ‰¹é‡æ“ä½œåçŠ¶æ€ ==="
kubectl get pods -l app=myapp -o wide

echo "=== æ‰©å®¹ç»“æœç»Ÿè®¡ ==="
TOTAL=$(kubectl get pods -l app=myapp --no-headers | wc -l)
RUNNING=$(kubectl get pods -l app=myapp --field-selector=status.phase=Running --no-headers | wc -l)
echo "æ€»Podæ•°: $TOTAL, è¿è¡Œä¸­: $RUNNING"
```

---

## 10. ğŸ” æƒé™æ§åˆ¶ä¸å®‰å…¨æ³¨æ„äº‹é¡¹


### 10.1 RBACæƒé™ç®¡ç†


**ğŸ”¸ ç†è§£RBAC**
RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰å°±åƒæ˜¯ç»™ä¸åŒçš„äººå‘ä¸åŒçš„"é’¥åŒ™"ï¼Œ**æ¯ä¸ªäººåªèƒ½å¼€å¯è‡ªå·±æœ‰æƒé™çš„"é—¨"**ã€‚è¿™ç¡®ä¿äº†é›†ç¾¤æ“ä½œçš„å®‰å…¨æ€§ã€‚

**ğŸ“Š RBACæ ¸å¿ƒæ¦‚å¿µ**
```
RBACç»„ä»¶å…³ç³»ï¼š
User/ServiceAccount â†’ RoleBinding â†’ Role â†’ Resources

è§’è‰²ç±»å‹ï¼š
â”œâ”€â”€ Role           â†’ å‘½åç©ºé—´çº§åˆ«æƒé™
â”œâ”€â”€ ClusterRole    â†’ é›†ç¾¤çº§åˆ«æƒé™
â”œâ”€â”€ RoleBinding    â†’ ç»‘å®šRoleåˆ°ç”¨æˆ·
â””â”€â”€ ClusterRoleBinding â†’ ç»‘å®šClusterRoleåˆ°ç”¨æˆ·
```

### 10.2 æƒé™æ£€æŸ¥ä¸æµ‹è¯•


**âš¡ æ£€æŸ¥å½“å‰ç”¨æˆ·æƒé™**
```bash
# æ£€æŸ¥æ˜¯å¦æœ‰åˆ›å»ºPodçš„æƒé™
kubectl auth can-i create pods

# æ£€æŸ¥åœ¨ç‰¹å®šå‘½åç©ºé—´çš„æƒé™
kubectl auth can-i delete deployments -n production

# æ£€æŸ¥æ‰€æœ‰æƒé™
kubectl auth can-i --list

# ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½æ£€æŸ¥æƒé™
kubectl auth can-i get pods --as=dev-user
```

**ğŸ” æƒé™æ•…éšœæ’æŸ¥**
```bash
# æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¿¡æ¯
kubectl config current-context
kubectl config view --minify

# æŸ¥çœ‹æœåŠ¡è´¦æˆ·æƒé™
kubectl describe serviceaccount default
kubectl get rolebindings,clusterrolebindings --all-namespaces -o wide | grep myuser
```

### 10.3 å®‰å…¨æ“ä½œå®è·µ


**ğŸ›¡ï¸ ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ“ä½œ**
```bash
# 1. ä½¿ç”¨åªè¯»æƒé™æ£€æŸ¥
kubectl get pods --dry-run=server  # æœåŠ¡ç«¯dry-runï¼Œæ£€æŸ¥æƒé™

# 2. åˆ†é˜¶æ®µæ“ä½œ
# å…ˆåœ¨devç¯å¢ƒæµ‹è¯•
kubectl apply -f app.yaml -n development
# éªŒè¯æ— è¯¯ååº”ç”¨åˆ°ç”Ÿäº§
kubectl apply -f app.yaml -n production

# 3. ä½¿ç”¨æœåŠ¡è´¦æˆ·
kubectl create serviceaccount deployment-sa
kubectl apply -f - <<EOF
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: deployment-manager
rules:
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "create", "update", "patch"]
EOF
```

**âš ï¸ å±é™©æ“ä½œé˜²æŠ¤**
```bash
# åˆ é™¤æ“ä½œäºŒæ¬¡ç¡®è®¤
function safe-delete() {
    local resource=$1
    echo "å³å°†åˆ é™¤: $resource"
    kubectl get $resource
    read -p "ç¡®è®¤åˆ é™¤ï¼Ÿ(è¾“å…¥DELETEç¡®è®¤): " confirm
    if [ "$confirm" = "DELETE" ]; then
        kubectl delete $resource
    else
        echo "æ“ä½œå–æ¶ˆ"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
safe-delete "deployment myapp"
```

### 10.4 å®¡è®¡ä¸ç›‘æ§


**ğŸ“Š æ“ä½œå®¡è®¡**
```bash
# æŸ¥çœ‹æœ€è¿‘çš„èµ„æºå˜æ›´äº‹ä»¶
kubectl get events --sort-by=.metadata.creationTimestamp

# ç›‘æ§ç‰¹å®šèµ„æºçš„å˜åŒ–
kubectl get events --watch --field-selector=involvedObject.kind=Deployment

# æŸ¥çœ‹ç”¨æˆ·æ“ä½œå†å²ï¼ˆéœ€è¦å¯ç”¨å®¡è®¡æ—¥å¿—ï¼‰
# è¿™é€šå¸¸åœ¨é›†ç¾¤å±‚é¢é…ç½®ï¼ŒæŸ¥çœ‹å®¡è®¡æ—¥å¿—æ–‡ä»¶
```

**ğŸ” å®‰å…¨ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# security-monitor.sh

echo "=== æƒé™æ£€æŸ¥ ==="
echo "å½“å‰ç”¨æˆ·: $(kubectl config current-context)"
echo "é›†ç¾¤æƒé™: $(kubectl auth can-i '*' '*' && echo 'ç®¡ç†å‘˜æƒé™' || echo 'å—é™æƒé™')"

echo ""
echo "=== æœ€è¿‘æ“ä½œè®°å½• ==="
kubectl get events --sort-by=.metadata.creationTimestamp | tail -10

echo ""
echo "=== é«˜å±æ“ä½œæé†’ ==="
kubectl get pods --all-namespaces | grep -E "(Terminating|Error|CrashLoopBackOff)" || echo "æ— å¼‚å¸¸Pod"

echo ""
echo "=== èµ„æºé…é¢ä½¿ç”¨ ==="
kubectl describe resourcequota --all-namespaces | grep -A 3 "Resource Quota"
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ kubectlé«˜çº§å‘½ä»¤æ ¸å¿ƒç†è§£**
```
å‘½ä»¤åˆ†ç±»è®°å¿†ï¼š
ğŸ“ ä¿®æ”¹ç±»å‘½ä»¤ï¼š
  â”œâ”€â”€ patch  â†’ éƒ¨åˆ†ä¿®æ”¹ï¼ˆæ‰“è¡¥ä¸ï¼‰
  â”œâ”€â”€ edit   â†’ åœ¨çº¿ç¼–è¾‘ï¼ˆå®æ—¶æ”¹ï¼‰  
  â””â”€â”€ replace â†’ å®Œå…¨æ›¿æ¢ï¼ˆé‡å†™ï¼‰

ğŸš€ ç®¡ç†ç±»å‘½ä»¤ï¼š
  â”œâ”€â”€ rollout â†’ ç‰ˆæœ¬ç®¡ç†ï¼ˆæ—¶å…‰æœºï¼‰
  â”œâ”€â”€ scale   â†’ æ‰©ç¼©å®¹ï¼ˆè°ƒæ°´é¾™å¤´ï¼‰
  â””â”€â”€ wait    â†’ çŠ¶æ€ç­‰å¾…ï¼ˆçº¢ç»¿ç¯ï¼‰
```

### 11.2 å…³é”®ä½¿ç”¨åœºæ™¯


**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆå‘½ä»¤**
```
å¿«é€Ÿä¿®æ”¹ â†’ ä½¿ç”¨ patch
  kubectl patch deployment myapp -p='{"spec":{"replicas":5}}'

å¤æ‚é…ç½® â†’ ä½¿ç”¨ edit  
  kubectl edit deployment myapp

ç‰ˆæœ¬å›æ»š â†’ ä½¿ç”¨ rollout
  kubectl rollout undo deployment/myapp

åŠ¨æ€æ‰©å®¹ â†’ ä½¿ç”¨ scale
  kubectl scale deployment myapp --replicas=10

è‡ªåŠ¨åŒ–ç­‰å¾… â†’ ä½¿ç”¨ wait
  kubectl wait --for=condition=Available deployment/myapp
```

### 11.3 å®‰å…¨æ“ä½œè¦ç‚¹


**ğŸ›¡ï¸ æ“ä½œå®‰å…¨æ¸…å•**
- âœ… **æ“ä½œå‰å¤‡ä»½**ï¼šé‡è¦èµ„æºä¿®æ”¹å‰å…ˆå¤‡ä»½
- âœ… **dry-runéªŒè¯**ï¼šç”Ÿäº§æ“ä½œå‰ç”¨`--dry-run`éªŒè¯
- âœ… **æƒé™æ£€æŸ¥**ï¼šç¡®è®¤æœ‰è¶³å¤Ÿæƒé™æ‰§è¡Œæ“ä½œ
- âœ… **åˆ†æ­¥éª¤æ‰§è¡Œ**ï¼šå¤æ‚æ“ä½œåˆ†æ­¥éª¤ï¼Œä¾¿äºå›æ»š
- âœ… **ç›‘æ§ç»“æœ**ï¼šæ“ä½œååŠæ—¶æ£€æŸ¥ç»“æœ

### 11.4 å®ç”¨æŠ€å·§æ€»ç»“


**ğŸ’¡ æé«˜æ•ˆç‡çš„æŠ€å·§**
```bash
# 1. è®¾ç½®æœ‰ç”¨çš„åˆ«å
alias k=kubectl
alias kgp='kubectl get pods -o wide'
alias kgs='kubectl get svc'

# 2. ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨æ‰¹é‡æ“ä½œ
kubectl scale deployment -l app=myapp --replicas=3

# 3. ç»“åˆç®¡é“ç¬¦å¤„ç†è¾“å‡º  
kubectl get pods -o name | xargs kubectl delete

# 4. ä½¿ç”¨JSONPathç²¾ç¡®æŸ¥è¯¢
kubectl get pods -o jsonpath='{.items[*].status.podIP}'
```

**ğŸ¯ è®°å¿†å£è¯€**
```
kubectlé«˜çº§å‘½ä»¤è¦è®°ç‰¢ï¼š
patchæ”¹éƒ¨åˆ†æœ€çµå·§ï¼Œ
editåœ¨çº¿æ”¹é…ç½®ï¼Œ
rolloutç‰ˆæœ¬èƒ½å›æ»šï¼Œ
scaleæ‰©ç¼©çœŸæ–¹ä¾¿ï¼Œ
replaceæ›¿æ¢è¦å°å¿ƒï¼Œ  
waitç­‰å¾…æ›´å®‰å…¨ã€‚
æ‰¹é‡æ“ä½œæ ‡ç­¾é€‰ï¼Œ
æƒé™å®‰å…¨è®°å¿ƒé—´ï¼
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- kubectlé«˜çº§å‘½ä»¤è®©K8sç®¡ç†æ›´ç²¾ç»†åŒ–
- æ¯ä¸ªå‘½ä»¤éƒ½æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ï¼Œé€‰å¯¹å·¥å…·äº‹åŠåŠŸå€  
- å®‰å…¨æ“ä½œæ°¸è¿œæ˜¯ç¬¬ä¸€ä½ï¼Œå…ˆæµ‹è¯•å†ç”Ÿäº§
- æ‰¹é‡æ“ä½œé…åˆæ ‡ç­¾é€‰æ‹©å™¨ï¼Œæ•ˆç‡å€å¢
- æŒæ¡è¾“å‡ºæ ¼å¼åŒ–å’ŒJSONPathï¼Œæ•…éšœæ’æŸ¥æ›´è½»æ¾