---
title: 8ã€CoreDNSé…ç½®ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [CoreDNSåŸºç¡€æ¦‚å¿µ](#1-CoreDNSåŸºç¡€æ¦‚å¿µ)
2. [Corefileé…ç½®æ–‡ä»¶è¯¦è§£](#2-Corefileé…ç½®æ–‡ä»¶è¯¦è§£)
3. [åŸŸåè§£æè§„åˆ™é…ç½®](#3-åŸŸåè§£æè§„åˆ™é…ç½®)
4. [ä¸Šæ¸¸DNSæœåŠ¡å™¨è®¾ç½®](#4-ä¸Šæ¸¸DNSæœåŠ¡å™¨è®¾ç½®)
5. [DNSç¼“å­˜ç­–ç•¥é…ç½®](#5-DNSç¼“å­˜ç­–ç•¥é…ç½®)
6. [è‡ªå®šä¹‰åŸŸåè§£æ](#6-è‡ªå®šä¹‰åŸŸåè§£æ)
7. [DNSè½¬å‘è§„åˆ™é…ç½®](#7-DNSè½¬å‘è§„åˆ™é…ç½®)
8. [å¥åº·æ£€æŸ¥ä¸ç›‘æ§](#8-å¥åº·æ£€æŸ¥ä¸ç›‘æ§)
9. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#9-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
10. [æ•…éšœæ’æŸ¥å®æˆ˜](#10-æ•…éšœæ’æŸ¥å®æˆ˜)
11. [èŠ‚ç‚¹æœ¬åœ°DNSç¼“å­˜](#11-èŠ‚ç‚¹æœ¬åœ°DNSç¼“å­˜)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ CoreDNSåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯CoreDNS


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šCoreDNSå°±åƒKubernetesé›†ç¾¤çš„"ç”µè¯ç°¿"ï¼Œå½“Podéœ€è¦æ‰¾å…¶ä»–æœåŠ¡æ—¶ï¼ŒCoreDNSå‘Šè¯‰å®ƒä»¬å…·ä½“çš„IPåœ°å€åœ¨å“ªé‡Œã€‚

**æ ¸å¿ƒå®šä¹‰**ï¼š
```
CoreDNSæ˜¯ä»€ä¹ˆï¼Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CoreDNS = Kubernetesçš„DNSæœåŠ¡å™¨     â”‚
â”‚                                     â”‚
â”‚ ä½œç”¨ï¼šæŠŠæœåŠ¡å â†’ è½¬æ¢æˆ â†’ IPåœ°å€    â”‚
â”‚                                     â”‚
â”‚ ä¾‹å¦‚ï¼šweb-service â†’ 10.96.1.100    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å·¥ä½œåŸç†ç®€å›¾**ï¼š
```
Podéœ€è¦è®¿é—®æ•°æ®åº“æœåŠ¡
         â†“
    "mysql-serviceåœ¨å“ªé‡Œï¼Ÿ"
         â†“
    è¯¢é—®CoreDNSæœåŠ¡å™¨
         â†“
    CoreDNSè¿”å›ï¼š10.96.2.50
         â†“
    Podè¿æ¥åˆ°10.96.2.50
```

### 1.2 CoreDNSåœ¨é›†ç¾¤ä¸­çš„ä½ç½®


**æ¶æ„ä½ç½®å›¾**ï¼š
```
Kubernetesé›†ç¾¤æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MasterèŠ‚ç‚¹              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚API-Serverâ”‚  â”‚   etcd      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   CoreDNS Pod   â”‚  â† è¿è¡Œåœ¨kube-systemå‘½åç©ºé—´
    â”‚  (DNSæœåŠ¡å™¨)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        WorkerèŠ‚ç‚¹               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚Pod Aâ”‚  â”‚Pod Bâ”‚  â”‚Pod Câ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜     â”‚
â”‚     â†‘        â†‘        â†‘        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         DNSæŸ¥è¯¢è¯·æ±‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦CoreDNS


**ä¼ ç»Ÿæ–¹å¼ vs CoreDNSæ–¹å¼**ï¼š
```
âŒ ä¼ ç»Ÿæ–¹å¼ï¼ˆç¡¬ç¼–ç IPï¼‰ï¼š
åº”ç”¨ä»£ç ï¼šè¿æ¥æ•°æ®åº“ â†’ 10.96.2.50:3306
é—®é¢˜ï¼šIPå˜äº†æ€ä¹ˆåŠï¼Ÿæ¯æ¬¡éƒ½è¦æ”¹ä»£ç ï¼

âœ… CoreDNSæ–¹å¼ï¼ˆæœåŠ¡åï¼‰ï¼š
åº”ç”¨ä»£ç ï¼šè¿æ¥æ•°æ®åº“ â†’ mysql-service:3306
å¥½å¤„ï¼šIPå˜äº†ä¸ç”¨æ”¹ä»£ç ï¼ŒCoreDNSè‡ªåŠ¨å¤„ç†ï¼
```

> ğŸ“Œ **æ–°æ‰‹é‡ç‚¹**ï¼šå°±åƒä½ è®°ä½æœ‹å‹çš„åå­—è€Œä¸æ˜¯ç”µè¯å·ç ï¼ŒCoreDNSè®©ä½ ç”¨å®¹æ˜“è®°ä½çš„æœåŠ¡åè€Œä¸æ˜¯éš¾è®°çš„IPåœ°å€ã€‚

---

## 2. ğŸ“ Corefileé…ç½®æ–‡ä»¶è¯¦è§£


### 2.1 Corefileæ˜¯ä»€ä¹ˆ


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šCorefileå°±æ˜¯CoreDNSçš„"è¯´æ˜ä¹¦"ï¼Œå‘Šè¯‰å®ƒå¦‚ä½•å¤„ç†ä¸åŒçš„DNSæŸ¥è¯¢è¯·æ±‚ã€‚

**CorefileåŸºæœ¬ç»“æ„**ï¼š
```
Corefileçš„ç»„æˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸŸåèŒƒå›´ {                      â”‚
â”‚      æ’ä»¶1                       â”‚
â”‚      æ’ä»¶2                       â”‚
â”‚      æ’ä»¶3                       â”‚
â”‚  }                               â”‚
â”‚                                  â”‚
â”‚  å¦ä¸€ä¸ªåŸŸåèŒƒå›´ {                 â”‚
â”‚      å…¶ä»–æ’ä»¶                    â”‚
â”‚  }                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 é»˜è®¤Corefileé…ç½®è¯¦è§£


```yaml
# æŸ¥çœ‹å½“å‰CoreDNSé…ç½®
kubectl get configmap coredns -n kube-system -o yaml
```

**é»˜è®¤é…ç½®è§£è¯»**ï¼š
```
.:53 {
    errors                    # â† è®°å½•é”™è¯¯æ—¥å¿—
    health {                  # â† å¥åº·æ£€æŸ¥æ¥å£
        lameduck 5s
    }
    ready                     # â† å°±ç»ªæ£€æŸ¥æ¥å£
    kubernetes cluster.local in-addr.arpa ip6.arpa {  # â† å¤„ç†é›†ç¾¤å†…DNS
        pods insecure
        fallthrough in-addr.arpa ip6.arpa
    }
    prometheus :9153          # â† ç›‘æ§æŒ‡æ ‡æ¥å£
    forward . /etc/resolv.conf {  # â† è½¬å‘åˆ°ä¸Šæ¸¸DNS
        max_concurrent 1000
    }
    cache 30                  # â† ç¼“å­˜30ç§’
    loop                      # â† æ£€æµ‹DNSå¾ªç¯
    reload                    # â† æ”¯æŒçƒ­é‡è½½
    loadbalance               # â† è´Ÿè½½å‡è¡¡
}
```

**é…ç½®é¡¹é€šä¿—è§£é‡Š**ï¼š
```
ğŸ”¸ .:53            â†’ ç›‘å¬æ‰€æœ‰åŸŸåçš„53ç«¯å£ï¼ˆDNSæ ‡å‡†ç«¯å£ï¼‰
ğŸ”¸ errors           â†’ å‡ºé”™äº†è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜
ğŸ”¸ health           â†’ æä¾›å¥åº·æ£€æŸ¥ï¼Œk8sçŸ¥é“DNSæ˜¯å¦æ­£å¸¸
ğŸ”¸ kubernetes       â†’ å¤„ç†é›†ç¾¤å†…éƒ¨çš„æœåŠ¡åè§£æ
ğŸ”¸ forward          â†’ é›†ç¾¤å¤–çš„åŸŸåè½¬å‘ç»™å¤–éƒ¨DNS
ğŸ”¸ cache 30         â†’ æŠŠæŸ¥è¯¢ç»“æœç¼“å­˜30ç§’ï¼Œæé«˜é€Ÿåº¦
```

### 2.3 é…ç½®æ–‡ä»¶çš„ä¿®æ”¹æ–¹å¼


**ä¿®æ”¹Corefileçš„æ­¥éª¤**ï¼š
```
æ­¥éª¤1ï¸âƒ£ ç¼–è¾‘ConfigMap
kubectl edit configmap coredns -n kube-system

æ­¥éª¤2ï¸âƒ£ é‡å¯CoreDNS Pod
kubectl rollout restart deployment/coredns -n kube-system

æ­¥éª¤3ï¸âƒ£ éªŒè¯é…ç½®ç”Ÿæ•ˆ
kubectl logs -n kube-system -l k8s-app=kube-dns
```

---

## 3. ğŸ¯ åŸŸåè§£æè§„åˆ™é…ç½®


### 3.1 KubernetesåŸŸåè§£æè§„åˆ™


**é›†ç¾¤å†…åŸŸåæ„æˆ**ï¼š
```
å®Œæ•´åŸŸåæ ¼å¼ï¼š
æœåŠ¡å.å‘½åç©ºé—´.svc.cluster.local

å®é™…ä¾‹å­ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ web-service.default.svc.cluster.local â”‚
â”‚      â†‘         â†‘      â†‘       â†‘     â”‚
â”‚   æœåŠ¡å    å‘½åç©ºé—´  æœåŠ¡  é›†ç¾¤åŸŸå  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŸŸåè§£æå±‚çº§**ï¼š
```
PodæŸ¥è¯¢åŸŸåçš„æœç´¢é¡ºåºï¼š
1ï¸âƒ£ web-service                          (åŒå‘½åç©ºé—´çŸ­å)
2ï¸âƒ£ web-service.default                  (æŒ‡å®šå‘½åç©ºé—´)  
3ï¸âƒ£ web-service.default.svc             (å®Œæ•´æœåŠ¡è·¯å¾„)
4ï¸âƒ£ web-service.default.svc.cluster.local (å®Œæ•´åŸŸå)
```

### 3.2 è‡ªå®šä¹‰åŸŸåè§„åˆ™


**æ·»åŠ è‡ªå®šä¹‰è§£æè§„åˆ™**ï¼š
```
# åœ¨Corefileä¸­æ·»åŠ è‡ªå®šä¹‰è§„åˆ™
company.local:53 {
    errors
    cache 300
    file /etc/coredns/company.db company.local
}
```

**è‡ªå®šä¹‰åŸŸåé…ç½®æ–‡ä»¶**ï¼š
```bash
# åˆ›å»ºè‡ªå®šä¹‰åŸŸåæ–‡ä»¶ company.db
$ORIGIN company.local.
@       3600 IN SOA ns.company.local. admin.company.local. (
                    2021010101 ; serial
                    3600       ; refresh
                    600        ; retry
                    604800     ; expire
                    300        ; minimum
                    )
        3600 IN NS  ns.company.local.

api     300  IN A   192.168.1.100
db      300  IN A   192.168.1.200
web     300  IN A   192.168.1.150
```

> ğŸ“Œ **æ–°æ‰‹é‡ç‚¹**ï¼šè‡ªå®šä¹‰åŸŸåè§„åˆ™è®©ä½ å¯ä»¥ä¸ºç‰¹å®šçš„åŸŸåè®¾ç½®ç‰¹æ®Šçš„è§£ææ–¹å¼ï¼Œæ¯”å¦‚å…¬å¸å†…éƒ¨çš„åŸŸåã€‚

---

## 4. ğŸŒ ä¸Šæ¸¸DNSæœåŠ¡å™¨è®¾ç½®


### 4.1 ä»€ä¹ˆæ˜¯ä¸Šæ¸¸DNS


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šä¸Šæ¸¸DNSå°±æ˜¯"é—®ä¸äº†çš„æ—¶å€™é—®è°"ã€‚å½“CoreDNSä¸çŸ¥é“æŸä¸ªåŸŸåæ—¶ï¼Œå®ƒä¼šé—®ä¸Šæ¸¸DNSæœåŠ¡å™¨ã€‚

**ä¸Šæ¸¸DNSå·¥ä½œæµç¨‹**ï¼š
```
é›†ç¾¤å†…æŸ¥è¯¢æµç¨‹ï¼š
PodæŸ¥è¯¢ â†’ CoreDNS â†’ é›†ç¾¤å†…æœ‰ç­”æ¡ˆ â†’ ç›´æ¥è¿”å›

é›†ç¾¤å¤–æŸ¥è¯¢æµç¨‹ï¼š
PodæŸ¥è¯¢ â†’ CoreDNS â†’ é›†ç¾¤å†…æ²¡ç­”æ¡ˆ â†’ è½¬å‘ç»™ä¸Šæ¸¸DNS â†’ è¿”å›ç»“æœ
```

### 4.2 é…ç½®ä¸Šæ¸¸DNSæœåŠ¡å™¨


**é»˜è®¤ä¸Šæ¸¸DNSé…ç½®**ï¼š
```
forward . /etc/resolv.conf {
    max_concurrent 1000
}
```

**è‡ªå®šä¹‰ä¸Šæ¸¸DNS**ï¼š
```
# ä½¿ç”¨æŒ‡å®šçš„DNSæœåŠ¡å™¨
forward . 8.8.8.8 8.8.4.4 {
    max_concurrent 1000
}

# ä½¿ç”¨å¤šä¸ªDNSæœåŠ¡å™¨ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
forward . 8.8.8.8 8.8.4.4 1.1.1.1 {
    policy sequential    # æŒ‰é¡ºåºå°è¯•
    health_check 5s      # æ¯5ç§’æ£€æŸ¥å¥åº·çŠ¶æ€
}
```

### 4.3 ä¸Šæ¸¸DNSçš„é€‰æ‹©ç­–ç•¥


**å¸¸ç”¨å…¬å…±DNSæœåŠ¡å™¨å¯¹æ¯”**ï¼š

| DNSæœåŠ¡å•† | **ä¸»DNS** | **å¤‡DNS** | **ç‰¹ç‚¹** |
|---------|----------|----------|---------|
| Google | `8.8.8.8` | `8.8.4.4` | `å…¨çƒè¦†ç›–ï¼Œé€Ÿåº¦å¿«` |
| Cloudflare | `1.1.1.1` | `1.0.0.1` | `éšç§ä¿æŠ¤ï¼Œä½å»¶è¿Ÿ` |
| é˜¿é‡ŒDNS | `223.5.5.5` | `223.6.6.6` | `å›½å†…ä¼˜åŒ–ï¼Œç¨³å®š` |
| è…¾è®¯DNS | `119.29.29.29` | `182.254.116.116` | `å›½å†…å¿«é€Ÿè®¿é—®` |

**é€‰æ‹©å»ºè®®**ï¼š
```
ğŸŒ å›½å¤–ç¯å¢ƒï¼šæ¨è Google DNS (8.8.8.8) æˆ– Cloudflare (1.1.1.1)
ğŸ‡¨ğŸ‡³ å›½å†…ç¯å¢ƒï¼šæ¨è é˜¿é‡ŒDNS (223.5.5.5) æˆ– è…¾è®¯DNS (119.29.29.29)
ğŸ¢ ä¼ä¸šç¯å¢ƒï¼šä½¿ç”¨å…¬å¸å†…éƒ¨DNSæœåŠ¡å™¨
```

---

## 5. âš¡ DNSç¼“å­˜ç­–ç•¥é…ç½®


### 5.1 DNSç¼“å­˜çš„ä½œç”¨


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šDNSç¼“å­˜å°±åƒ"ç”µè¯ç°¿çš„ä¾¿åˆ©è´´"ï¼ŒæŠŠå¸¸ç”¨çš„ç”µè¯å·ç è´´åœ¨æ˜¾çœ¼ä½ç½®ï¼Œä¸‹æ¬¡æŸ¥æ‰¾æ›´å¿«ã€‚

**ç¼“å­˜å·¥ä½œåŸç†**ï¼š
```
ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼š
Pod â†’ CoreDNS â†’ æŸ¥è¯¢ä¸Šæ¸¸DNS â†’ ç¼“å­˜ç»“æœ â†’ è¿”å›ç»™Pod
(è€—æ—¶ï¼š100ms)

åç»­ç›¸åŒæŸ¥è¯¢ï¼š
Pod â†’ CoreDNS â†’ ç›´æ¥ä»ç¼“å­˜è¿”å› â†’ è¿”å›ç»™Pod  
(è€—æ—¶ï¼š5ms)
```

### 5.2 ç¼“å­˜é…ç½®å‚æ•°


**åŸºç¡€ç¼“å­˜é…ç½®**ï¼š
```
cache 30                    # ç¼“å­˜30ç§’
cache 300                   # ç¼“å­˜5åˆ†é’Ÿ
cache 3600                  # ç¼“å­˜1å°æ—¶
```

**é«˜çº§ç¼“å­˜é…ç½®**ï¼š
```
cache 30 {
    success 9984 30          # æˆåŠŸæŸ¥è¯¢ç¼“å­˜30ç§’ï¼Œæœ€å¤š9984ä¸ªæ¡ç›®
    denial 9984 5            # å¤±è´¥æŸ¥è¯¢ç¼“å­˜5ç§’ï¼Œæœ€å¤š9984ä¸ªæ¡ç›®  
    prefetch 1 10m 10%       # é¢„å–åŠŸèƒ½ï¼šå‰©ä½™10%æ—¶é—´æ—¶é¢„å–
}
```

### 5.3 ç¼“å­˜ç­–ç•¥çš„é€‰æ‹©


**ä¸åŒåœºæ™¯çš„ç¼“å­˜æ—¶é—´å»ºè®®**ï¼š
```
ğŸ“Š ç¼“å­˜æ—¶é—´é€‰æ‹©ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨åœºæ™¯      â”‚ ç¼“å­˜æ—¶é—´ â”‚    åŸå›      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼€å‘æµ‹è¯•ç¯å¢ƒ    â”‚  10-30ç§’ â”‚ å˜æ›´é¢‘ç¹    â”‚
â”‚ ç”Ÿäº§ç¯å¢ƒ       â”‚ 300-600ç§’â”‚ ç¨³å®šä¼˜å…ˆ    â”‚
â”‚ é™æ€å†…å®¹       â”‚ 3600ç§’   â”‚ å¾ˆå°‘å˜åŒ–    â”‚
â”‚ åŠ¨æ€API        â”‚  30-60ç§’ â”‚ å¹³è¡¡æ€§èƒ½    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šç¼“å­˜æ—¶é—´å¤ªçŸ­å½±å“æ€§èƒ½ï¼Œå¤ªé•¿å¯èƒ½å¯¼è‡´DNSå˜æ›´ç”Ÿæ•ˆæ…¢ã€‚

---

## 6. ğŸ¨ è‡ªå®šä¹‰åŸŸåè§£æ


### 6.1 é™æ€åŸŸåè§£æ


**æ·»åŠ é™æ€è§£æè®°å½•**ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: custom-dns
  namespace: kube-system
data:
  custom.db: |
    $ORIGIN internal.company.
    @   IN  SOA ns.internal.company. admin.company.com. (
                2021010101 ; serial
                3600       ; refresh  
                600        ; retry
                604800     ; expire
                300        ; minimum
                )
    @           IN  NS  ns.internal.company.
    api         IN  A   10.0.1.100
    database    IN  A   10.0.1.200
    cache       IN  A   10.0.1.150
```

### 6.2 åŠ¨æ€åŸŸåè§£æ


**ä½¿ç”¨etcdæ’ä»¶å®ç°åŠ¨æ€è§£æ**ï¼š
```
# Corefileé…ç½®
internal.company:53 {
    etcd {
        stubzones
        path /dns
        endpoint http://etcd:2379
    }
    cache 300
}
```

### 6.3 æ¡ä»¶åŸŸåè§£æ


**åŸºäºæ¥æºçš„æ¡ä»¶è§£æ**ï¼š
```
# ä¸åŒç½‘æ®µä½¿ç”¨ä¸åŒçš„è§£æ
.:53 {
    kubernetes cluster.local in-addr.arpa ip6.arpa
    
    # å¼€å‘ç¯å¢ƒç½‘æ®µ
    acl dev-network 10.1.0.0/16
    
    # ç”Ÿäº§ç¯å¢ƒç½‘æ®µ  
    acl prod-network 10.2.0.0/16
    
    forward . 8.8.8.8 {
        policy random
    }
}

dev.local:53 {
    forward . 10.1.1.1
    acl allow dev-network
}
```

---

## 7. ğŸ”€ DNSè½¬å‘è§„åˆ™é…ç½®


### 7.1 DNSè½¬å‘çš„æ¦‚å¿µ


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šDNSè½¬å‘å°±åƒ"é—®ä¸åŒçš„ä¸“å®¶"ï¼Œä¸åŒç±»å‹çš„é—®é¢˜é—®ä¸åŒçš„ä¸“å®¶ã€‚

**è½¬å‘è§„åˆ™ç¤ºæ„å›¾**ï¼š
```
DNSæŸ¥è¯¢åˆ†å‘ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CoreDNS                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ *.cluster.local  â†’ å†…éƒ¨å¤„ç†         â”‚
â”‚ *.company.com    â†’ å…¬å¸DNSæœåŠ¡å™¨    â”‚
â”‚ *.google.com     â†’ 8.8.8.8          â”‚
â”‚ å…¶ä»–åŸŸå         â†’ é»˜è®¤ä¸Šæ¸¸DNS      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 åŸºç¡€è½¬å‘é…ç½®


**ç®€å•è½¬å‘é…ç½®**ï¼š
```
# åŸºç¡€è½¬å‘
forward . 8.8.8.8 8.8.4.4

# æŒ‡å®šåŸŸåè½¬å‘
company.com:53 {
    forward . 10.0.1.1 10.0.1.2
    cache 300
}
```

### 7.3 é«˜çº§è½¬å‘è§„åˆ™


**å¤æ‚è½¬å‘åœºæ™¯é…ç½®**ï¼š
```
.:53 {
    # å¤„ç†é›†ç¾¤å†…éƒ¨åŸŸå
    kubernetes cluster.local in-addr.arpa ip6.arpa {
        pods insecure
        fallthrough in-addr.arpa ip6.arpa
    }
    
    # å…¬å¸å†…éƒ¨åŸŸåè½¬å‘ç»™å†…éƒ¨DNS
    forward company.local corp.local 10.0.1.1 {
        max_concurrent 1000
        health_check 5s
    }
    
    # å¼€å‘ç¯å¢ƒåŸŸå
    forward dev.company.com 10.1.1.1 {
        policy sequential
        health_check 10s
    }
    
    # å…¶ä»–åŸŸåä½¿ç”¨å…¬å…±DNS
    forward . 8.8.8.8 1.1.1.1 {
        policy random
        max_concurrent 1000
    }
    
    cache 300
    errors
    log
}
```

**è½¬å‘ç­–ç•¥é€‰é¡¹**ï¼š
```
ğŸ”¸ policy random      â†’ éšæœºé€‰æ‹©DNSæœåŠ¡å™¨
ğŸ”¸ policy round_robin  â†’ è½®è¯¢é€‰æ‹©DNSæœåŠ¡å™¨  
ğŸ”¸ policy sequential   â†’ æŒ‰é¡ºåºå°è¯•DNSæœåŠ¡å™¨
ğŸ”¸ policy first        â†’ æ€»æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªDNSæœåŠ¡å™¨
```

---

## 8. ğŸ¥ å¥åº·æ£€æŸ¥ä¸ç›‘æ§


### 8.1 CoreDNSå¥åº·æ£€æŸ¥


**å¥åº·æ£€æŸ¥æ¥å£**ï¼š
```bash
# æ£€æŸ¥CoreDNSæ˜¯å¦è¿è¡Œæ­£å¸¸
curl http://<coredns-pod-ip>:8080/health

# æ£€æŸ¥CoreDNSæ˜¯å¦å‡†å¤‡å°±ç»ª
curl http://<coredns-pod-ip>:8181/ready
```

**å¥åº·æ£€æŸ¥é…ç½®**ï¼š
```
.:53 {
    health {
        lameduck 5s    # ä¼˜é›…å…³é—­æ—¶é—´
    }
    ready             # å¯ç”¨å°±ç»ªæ£€æŸ¥
    errors            # è®°å½•é”™è¯¯ä¿¡æ¯
    log               # å¯ç”¨æŸ¥è¯¢æ—¥å¿—
}
```

### 8.2 ç›‘æ§æŒ‡æ ‡é…ç½®


**Prometheusç›‘æ§é…ç½®**ï¼š
```
.:53 {
    prometheus :9153    # åœ¨9153ç«¯å£æä¾›æŒ‡æ ‡
    errors
    log
}
```

**é‡è¦ç›‘æ§æŒ‡æ ‡**ï¼š
```
ğŸ“Š å…³é”®æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æŒ‡æ ‡åç§°       â”‚        è¯´æ˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ coredns_dns_requestsâ”‚    DNSè¯·æ±‚æ€»æ•°      â”‚
â”‚ coredns_dns_responsesâ”‚   DNSå“åº”æ€»æ•°      â”‚
â”‚ coredns_cache_hits  â”‚     ç¼“å­˜å‘½ä¸­æ•°      â”‚
â”‚ coredns_cache_missesâ”‚     ç¼“å­˜æœªå‘½ä¸­æ•°    â”‚
â”‚ coredns_forward_requestsâ”‚ è½¬å‘è¯·æ±‚æ•°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 æ—¥å¿—é…ç½®ä¸åˆ†æ


**å¯ç”¨è¯¦ç»†æ—¥å¿—**ï¼š
```
.:53 {
    log {
        class denial error
    }
    errors {
        consolidate 5m ".* i/o timeout$" warning
    }
}
```

**æ—¥å¿—åˆ†æå‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹CoreDNSæ—¥å¿—
kubectl logs -n kube-system -l k8s-app=kube-dns

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
kubectl logs -n kube-system -l k8s-app=kube-dns -f

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´çš„æ—¥å¿—
kubectl logs -n kube-system -l k8s-app=kube-dns --since=1h
```

---

## 9. ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 9.1 ç¼“å­˜ä¼˜åŒ–


**ç¼“å­˜å‚æ•°è°ƒä¼˜**ï¼š
```
# ä¼˜åŒ–åçš„ç¼“å­˜é…ç½®
cache 300 {
    success 10000 300     # æˆåŠŸè®°å½•ç¼“å­˜5åˆ†é’Ÿ
    denial 1000 30        # å¤±è´¥è®°å½•ç¼“å­˜30ç§’
    prefetch 2 5m 20%     # é¢„å–ä¼˜åŒ–
}
```

### 9.2 å¹¶å‘ä¼˜åŒ–


**å¹¶å‘å¤„ç†ä¼˜åŒ–**ï¼š
```
forward . 8.8.8.8 1.1.1.1 {
    max_concurrent 2000   # å¢åŠ å¹¶å‘è¿æ¥æ•°
    policy random         # éšæœºåˆ†å‘å‡å°‘å•ç‚¹å‹åŠ›
    health_check 5s       # å¥åº·æ£€æŸ¥ç¡®ä¿å¯ç”¨æ€§
}
```

### 9.3 èµ„æºé…ç½®ä¼˜åŒ–


**CoreDNSèµ„æºé™åˆ¶è°ƒä¼˜**ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: coredns
  namespace: kube-system
spec:
  template:
    spec:
      containers:
      - name: coredns
        resources:
          limits:
            cpu: 500m      # å¢åŠ CPUé™åˆ¶
            memory: 512Mi  # å¢åŠ å†…å­˜é™åˆ¶
          requests:
            cpu: 100m
            memory: 128Mi
```

**æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼š
```bash
# ä½¿ç”¨digæµ‹è¯•DNSè§£ææ€§èƒ½
time dig @<coredns-ip> kubernetes.default.svc.cluster.local

# æ‰¹é‡æµ‹è¯•
for i in {1..100}; do
  dig @<coredns-ip> test-service.default.svc.cluster.local >/dev/null
done
```

---

## 10. ğŸ” æ•…éšœæ’æŸ¥å®æˆ˜


### 10.1 å¸¸è§DNSé—®é¢˜


**DNSè§£æå¤±è´¥æ’æŸ¥æ­¥éª¤**ï¼š
```
æ’æŸ¥æµç¨‹ï¼š
1ï¸âƒ£ æ£€æŸ¥Podçš„DNSé…ç½®
kubectl exec -it <pod-name> -- cat /etc/resolv.conf

2ï¸âƒ£ æ£€æŸ¥CoreDNS PodçŠ¶æ€  
kubectl get pods -n kube-system -l k8s-app=kube-dns

3ï¸âƒ£ æ£€æŸ¥CoreDNSé…ç½®
kubectl get configmap coredns -n kube-system -o yaml

4ï¸âƒ£ æŸ¥çœ‹CoreDNSæ—¥å¿—
kubectl logs -n kube-system -l k8s-app=kube-dns
```

### 10.2 è¯Šæ–­å·¥å…·ä½¿ç”¨


**DNSè¯Šæ–­å‘½ä»¤é›†**ï¼š
```bash
# åœ¨Podå†…æµ‹è¯•DNSè§£æ
kubectl exec -it <pod-name> -- nslookup kubernetes.default

# æµ‹è¯•ç‰¹å®šDNSæœåŠ¡å™¨
kubectl exec -it <pod-name> -- nslookup google.com 8.8.8.8

# æ£€æŸ¥DNSæœç´¢åŸŸ
kubectl exec -it <pod-name> -- cat /etc/resolv.conf

# ä½¿ç”¨digå·¥å…·è¯¦ç»†æµ‹è¯•
kubectl exec -it <pod-name> -- dig +trace kubernetes.default.svc.cluster.local
```

### 10.3 å…¸å‹æ•…éšœæ¡ˆä¾‹


**æ¡ˆä¾‹1ï¼šæœåŠ¡æ— æ³•è§£æ**
```
é—®é¢˜ç°è±¡ï¼šPodæ— æ³•é€šè¿‡æœåŠ¡åè®¿é—®å…¶ä»–æœåŠ¡

æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å­˜åœ¨
   kubectl get svc -A | grep <service-name>

2. æ£€æŸ¥æœåŠ¡çš„ClusterIP  
   kubectl describe svc <service-name>

3. æ£€æŸ¥DNSè§£æ
   kubectl exec -it <pod> -- nslookup <service-name>

è§£å†³æ–¹æ¡ˆï¼š
- ç¡®è®¤æœåŠ¡åæ­£ç¡®
- æ£€æŸ¥å‘½åç©ºé—´æ˜¯å¦æ­£ç¡®
- éªŒè¯CoreDNSé…ç½®
```

**æ¡ˆä¾‹2ï¼šDNSæŸ¥è¯¢è¶…æ—¶**
```
é—®é¢˜ç°è±¡ï¼šDNSæŸ¥è¯¢å“åº”æ…¢æˆ–è¶…æ—¶

æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥CoreDNSèµ„æºä½¿ç”¨
   kubectl top pods -n kube-system -l k8s-app=kube-dns

2. æ£€æŸ¥ä¸Šæ¸¸DNSè¿é€šæ€§
   kubectl exec -it <coredns-pod> -- dig @8.8.8.8 google.com

3. åˆ†æç½‘ç»œå»¶è¿Ÿ
   kubectl exec -it <pod> -- ping 8.8.8.8

è§£å†³æ–¹æ¡ˆï¼š  
- è°ƒæ•´DNSç¼“å­˜æ—¶é—´
- å¢åŠ CoreDNSå‰¯æœ¬æ•°
- ä¼˜åŒ–ä¸Šæ¸¸DNSé…ç½®
```

---

## 11. ğŸ’¾ èŠ‚ç‚¹æœ¬åœ°DNSç¼“å­˜


### 11.1 NodeLocal DNSCacheæ¦‚å¿µ


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šèŠ‚ç‚¹æœ¬åœ°DNSç¼“å­˜å°±æ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ”¾ä¸€ä¸ª"å°DNSæœåŠ¡å™¨"ï¼Œè®©PodæŸ¥è¯¢DNSæ›´å¿«ã€‚

**NodeLocal DNSCacheæ¶æ„**ï¼š
```
ä¼ ç»Ÿæ¶æ„ï¼š
Pod â†’ CoreDNS Pod â†’ ä¸Šæ¸¸DNS

NodeLocalæ¶æ„ï¼š
Pod â†’ èŠ‚ç‚¹æœ¬åœ°DNSç¼“å­˜ â†’ CoreDNS Pod â†’ ä¸Šæ¸¸DNS
     â†‘________________â†“
       (ç¼“å­˜å‘½ä¸­ç›´æ¥è¿”å›)
```

### 11.2 éƒ¨ç½²NodeLocal DNSCache


**éƒ¨ç½²é…ç½®**ï¼š
```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-local-dns
  namespace: kube-system
spec:
  selector:
    matchLabels:
      k8s-app: node-local-dns
  template:
    metadata:
      labels:
        k8s-app: node-local-dns
    spec:
      hostNetwork: true
      dnsPolicy: Default
      containers:
      - name: node-cache
        image: k8s.gcr.io/dns/k8s-dns-node-cache:1.22.20
        args:
        - -localip
        - "169.254.20.10"  # æœ¬åœ°ç¼“å­˜IP
        - -conf
        - /etc/Corefile
        - -upstreamsvc
        - kube-dns-upstream
```

### 11.3 é…ç½®ä¼˜åŒ–


**NodeLocal DNSé…ç½®æ–‡ä»¶**ï¼š
```
cluster.local:53 {
    errors
    cache {
        success 9984 30      # æˆåŠŸç¼“å­˜30ç§’
        denial 9984 5        # å¤±è´¥ç¼“å­˜5ç§’
    }
    reload
    loop
    bind 169.254.20.10     # ç»‘å®šæœ¬åœ°IP
    forward . __PILLAR__CLUSTER__DNS__ {
        force_tcp
    }
    prometheus :9253
    health 169.254.20.10:8080
}
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
```
ğŸ“Š æ€§èƒ½æå‡å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æŒ‡æ ‡é¡¹       â”‚  ä¼ ç»Ÿæ–¹å¼ â”‚ NodeLocal â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DNSæŸ¥è¯¢å»¶è¿Ÿ     â”‚   50ms   â”‚   5ms    â”‚
â”‚ ç½‘ç»œè·³æ•°       â”‚    2è·³    â”‚   1è·³    â”‚
â”‚ CoreDNSè´Ÿè½½    â”‚   100%   â”‚   30%    â”‚
â”‚ ç¼“å­˜å‘½ä¸­ç‡     â”‚   60%    â”‚   85%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> ğŸ¯ **CoreDNSæ ¸å¿ƒä½œç”¨**ï¼š
```
ğŸ”¸ æœåŠ¡å‘ç°ï¼šæŠŠæœåŠ¡åè½¬æ¢ä¸ºIPåœ°å€
ğŸ”¸ åŸŸåè§£æï¼šå¤„ç†é›†ç¾¤å†…å¤–çš„åŸŸåæŸ¥è¯¢  
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šåœ¨å¤šä¸ªIPåœ°å€é—´åˆ†å‘è¯·æ±‚
ğŸ”¸ ç¼“å­˜åŠ é€Ÿï¼šå‡å°‘é‡å¤æŸ¥è¯¢çš„å»¶è¿Ÿ
```

> ğŸ”§ **Corefileé…ç½®è¦ç‚¹**ï¼š
```  
ğŸ”¸ åŸŸåèŒƒå›´ï¼šæŒ‡å®šå¤„ç†å“ªäº›åŸŸåçš„è§„åˆ™
ğŸ”¸ æ’ä»¶ç»„åˆï¼šä¸åŒæ’ä»¶æä¾›ä¸åŒåŠŸèƒ½
ğŸ”¸ è½¬å‘è§„åˆ™ï¼šå†³å®šå¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„æŸ¥è¯¢
ğŸ”¸ ç¼“å­˜ç­–ç•¥ï¼šå¹³è¡¡æ€§èƒ½å’Œæ•°æ®æ–°é²œåº¦
```

### 12.2 å…³é”®æ“ä½œæŠ€èƒ½


**ğŸ› ï¸ æ—¥å¸¸è¿ç»´æŠ€èƒ½**ï¼š
```
âœ… æŸ¥çœ‹å’Œä¿®æ”¹DNSé…ç½®
kubectl edit configmap coredns -n kube-system

âœ… é‡å¯CoreDNSåº”ç”¨é…ç½®
kubectl rollout restart deployment/coredns -n kube-system

âœ… æ£€æŸ¥DNSè§£æçŠ¶æ€
kubectl exec -it <pod> -- nslookup <service-name>

âœ… åˆ†æDNSæ€§èƒ½å’Œé”™è¯¯
kubectl logs -n kube-system -l k8s-app=kube-dns
```

### 12.3 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹


**ğŸš€ ä¼˜åŒ–ç­–ç•¥æ€»ç»“**ï¼š
```
ç¼“å­˜ä¼˜åŒ–ï¼š
- åˆç†è®¾ç½®ç¼“å­˜æ—¶é—´ï¼ˆç”Ÿäº§ç¯å¢ƒ300-600ç§’ï¼‰
- å¯ç”¨é¢„å–åŠŸèƒ½æå‰åˆ·æ–°ç¼“å­˜
- åŒºåˆ†æˆåŠŸå’Œå¤±è´¥æŸ¥è¯¢çš„ç¼“å­˜æ—¶é—´

èµ„æºä¼˜åŒ–ï¼š  
- é€‚å½“å¢åŠ CoreDNSçš„CPUå’Œå†…å­˜é™åˆ¶
- éƒ¨ç½²NodeLocal DNSCacheå‡å°‘ç½‘ç»œè·³æ•°
- ä½¿ç”¨å¤šä¸ªä¸Šæ¸¸DNSæœåŠ¡å™¨æé«˜å¯ç”¨æ€§

ç›‘æ§è¯Šæ–­ï¼š
- å¯ç”¨Prometheusç›‘æ§æ”¶é›†æ€§èƒ½æŒ‡æ ‡  
- é…ç½®æ—¥å¿—è®°å½•ä¾¿äºé—®é¢˜æ’æŸ¥
- å®šæœŸæ£€æŸ¥DNSæŸ¥è¯¢çš„å“åº”æ—¶é—´
```

### 12.4 æ•…éšœæ’æŸ¥æµç¨‹


**ğŸ” æ ‡å‡†æ’æŸ¥æµç¨‹**ï¼š
```
ç¬¬1æ­¥ï¼šç¡®è®¤é—®é¢˜ç°è±¡
- DNSè§£æå¤±è´¥è¿˜æ˜¯å“åº”æ…¢ï¼Ÿ
- å½±å“èŒƒå›´æ˜¯å•ä¸ªPodè¿˜æ˜¯æ•´ä¸ªé›†ç¾¤ï¼Ÿ

ç¬¬2æ­¥ï¼šæ£€æŸ¥åŸºç¡€ç»„ä»¶  
- CoreDNS Podæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿ
- ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ï¼Ÿ

ç¬¬3æ­¥ï¼šåˆ†æé…ç½®å’Œæ—¥å¿—
- Corefileé…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
- æ—¥å¿—ä¸­æœ‰å“ªäº›é”™è¯¯ä¿¡æ¯ï¼Ÿ

ç¬¬4æ­¥ï¼šéªŒè¯ä¿®å¤æ•ˆæœ
- é—®é¢˜æ˜¯å¦å·²ç»è§£å†³ï¼Ÿ
- æ€§èƒ½æ˜¯å¦å¾—åˆ°æ”¹å–„ï¼Ÿ
```

### 12.5 æœ€ä½³å®è·µå»ºè®®


> ğŸ’¡ **ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
```
ğŸ”¸ é«˜å¯ç”¨æ€§ï¼šéƒ¨ç½²å¤šå‰¯æœ¬CoreDNSç¡®ä¿æœåŠ¡å¯ç”¨
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šè®¾ç½®DNSæŸ¥è¯¢å»¶è¿Ÿå’Œå¤±è´¥ç‡å‘Šè­¦  
ğŸ”¸ å®šæœŸç»´æŠ¤ï¼šå®šæœŸæ£€æŸ¥å’Œæ›´æ–°DNSé…ç½®
ğŸ”¸ æ–‡æ¡£è®°å½•ï¼šè®°å½•æ‰€æœ‰DNSé…ç½®å˜æ›´å’ŒåŸå› 
ğŸ”¸ æµ‹è¯•éªŒè¯ï¼šé…ç½®å˜æ›´å‰åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
```

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- CoreDNSæ˜¯Kubernetesçš„DNSæœåŠ¡ï¼Œè´Ÿè´£æœåŠ¡å‘ç°
- Corefileæ˜¯é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰DNSå¤„ç†è§„åˆ™
- ç¼“å­˜å’Œè½¬å‘æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®
- æ—¥å¿—å’Œç›‘æ§æ˜¯æ•…éšœæ’æŸ¥çš„åŸºç¡€
- NodeLocal DNSCacheå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½

---

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
CoreDNSç®¡é›†ç¾¤ï¼ŒæœåŠ¡å‘ç°å®ƒå½“å…ˆ
Corefileå†™è§„åˆ™ï¼Œç¼“å­˜è½¬å‘è¦é…å…¨  
ç›‘æ§æ—¥å¿—ä¸èƒ½å°‘ï¼Œæ•…éšœæ’æŸ¥æœ‰ç« æ³•
æ€§èƒ½ä¼˜åŒ–æŠ“é‡ç‚¹ï¼Œç”Ÿäº§ç¯å¢ƒç¨³å¦‚å±±
```