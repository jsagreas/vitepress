---
title: 4ã€æ±¡ç‚¹ä¸å®¹å¿æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [æ±¡ç‚¹ä¸å®¹å¿æœºåˆ¶åŸºæœ¬æ¦‚å¿µ](#1-æ±¡ç‚¹ä¸å®¹å¿æœºåˆ¶åŸºæœ¬æ¦‚å¿µ)
2. [Taintsæ±¡ç‚¹è¯¦è§£](#2-Taintsæ±¡ç‚¹è¯¦è§£)
3. [Tolerationså®¹å¿é…ç½®](#3-Tolerationså®¹å¿é…ç½®)
4. [æ±¡ç‚¹å®¹å¿åŒ¹é…è§„åˆ™](#4-æ±¡ç‚¹å®¹å¿åŒ¹é…è§„åˆ™)
5. [èŠ‚ç‚¹ç»´æŠ¤åœºæ™¯åº”ç”¨](#5-èŠ‚ç‚¹ç»´æŠ¤åœºæ™¯åº”ç”¨)
6. [å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ](#6-å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ±¡ç‚¹ä¸å®¹å¿æœºåˆ¶åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ±¡ç‚¹ä¸å®¹å¿


ğŸ’­ **å…ˆæƒ³è±¡ä¸€ä¸ªç”Ÿæ´»åœºæ™¯**ï¼š
```
åŒ»é™¢ç—…æˆ¿åœºæ™¯ï¼š
â€¢ æ™®é€šç—…æˆ¿ â†’ ä»»ä½•ç—…äººéƒ½å¯ä»¥ä½
â€¢ ä¼ æŸ“ç—…æˆ¿ â†’ åªæœ‰ç‰¹æ®ŠåŒ»æŠ¤äººå‘˜èƒ½è¿›å…¥
â€¢ æ‰‹æœ¯å®¤ â†’ åªæœ‰å…·å¤‡æ‰‹æœ¯èµ„æ ¼çš„åŒ»ç”Ÿèƒ½è¿›å…¥

KubernetesèŠ‚ç‚¹å°±åƒè¿™äº›æˆ¿é—´ï¼š
â€¢ æ™®é€šèŠ‚ç‚¹ â†’ ä»»ä½•Podéƒ½å¯ä»¥è°ƒåº¦
â€¢ æœ‰æ±¡ç‚¹çš„èŠ‚ç‚¹ â†’ åªæœ‰èƒ½"å®¹å¿"è¿™ä¸ªæ±¡ç‚¹çš„Podæ‰èƒ½è°ƒåº¦ä¸Šå»
```

ğŸ” **æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
- **Taints (æ±¡ç‚¹)**ï¼šç»™èŠ‚ç‚¹æ‰“ä¸Š"ç‰¹æ®Šæ ‡è®°"ï¼Œé˜»æ­¢æŸäº›Podè°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹
- **Tolerations (å®¹å¿)**ï¼šPodå£°æ˜èƒ½å¤Ÿ"å¿å—"æŸäº›æ±¡ç‚¹ï¼Œå…è®¸è°ƒåº¦åˆ°æœ‰æ±¡ç‚¹çš„èŠ‚ç‚¹

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ±¡ç‚¹å®¹å¿æœºåˆ¶


ğŸ¤” **è§£å†³çš„å®é™…é—®é¢˜**ï¼š

**åœºæ™¯1ï¼šä¸“ç”¨èŠ‚ç‚¹**
```
GPUèŠ‚ç‚¹ï¼šä¸“é—¨è·‘æœºå™¨å­¦ä¹ ä»»åŠ¡
- ä¸å¸Œæœ›æ™®é€šPodå ç”¨æ˜‚è´µçš„GPUèµ„æº
- åªè®©MLç›¸å…³çš„Podè°ƒåº¦åˆ°GPUèŠ‚ç‚¹

è§£å†³æ–¹æ¡ˆï¼š
GPUèŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹ â†’ æ™®é€šPodè¢«"æ‹’ç»"
ML Podè®¾ç½®å®¹å¿ â†’ å¯ä»¥è°ƒåº¦åˆ°GPUèŠ‚ç‚¹
```

**åœºæ™¯2ï¼šèŠ‚ç‚¹ç»´æŠ¤**
```
èŠ‚ç‚¹éœ€è¦ç»´æŠ¤ï¼š
- æš‚æ—¶ä¸æƒ³æ–°Podè°ƒåº¦è¿‡æ¥
- å·²æœ‰Podå¯ä»¥ç»§ç»­è¿è¡Œæˆ–é€æ­¥è¿ç§»

è§£å†³æ–¹æ¡ˆï¼š
ç»™èŠ‚ç‚¹æ‰“ä¸Šç»´æŠ¤æ±¡ç‚¹ â†’ æ–°Podä¸ä¼šè°ƒåº¦è¿‡æ¥
å·²æœ‰Podæ ¹æ®æ±¡ç‚¹ç±»å‹å†³å®šæ˜¯å¦éœ€è¦è¿ç§»
```

### 1.3 å·¥ä½œåŸç†ç®€å›¾


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ™®é€šèŠ‚ç‚¹      â”‚    â”‚  æœ‰æ±¡ç‚¹èŠ‚ç‚¹      â”‚
â”‚                 â”‚    â”‚ Taint: gpu=true  â”‚
â”‚   ä»»ä½•Podéƒ½å¯ä»¥  â”‚    â”‚                 â”‚
â”‚   è°ƒåº¦åˆ°è¿™é‡Œ     â”‚    â”‚ åªæœ‰å®¹å¿gpuæ±¡ç‚¹çš„â”‚
â”‚                 â”‚    â”‚ Podæ‰èƒ½è°ƒåº¦      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘                        â†‘
         â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚æ™®é€šPod  â”‚              â”‚ML Pod   â”‚
    â”‚æ— å®¹å¿é…ç½®â”‚              â”‚å®¹å¿gpu  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âš—ï¸ Taintsæ±¡ç‚¹è¯¦è§£


### 2.1 æ±¡ç‚¹çš„åŸºæœ¬è¯­æ³•


ğŸ·ï¸ **æ±¡ç‚¹æ ¼å¼**ï¼š`key=value:effect`

**å„éƒ¨åˆ†å«ä¹‰**ï¼š
- **key**: æ±¡ç‚¹çš„åç§°æ ‡è¯†
- **value**: æ±¡ç‚¹çš„å€¼ï¼ˆå¯é€‰ï¼‰
- **effect**: æ±¡ç‚¹çš„æ•ˆæœç±»å‹

ğŸŒ° **å…·ä½“ä¾‹å­**ï¼š
```bash
# å®Œæ•´æ ¼å¼
node-role.kubernetes.io/master=true:NoSchedule

# åªæœ‰keyå’Œeffect
maintenance:NoExecute

# è§£è¯»ï¼š
# key: maintenance
# value: æ— ï¼ˆç©ºå€¼ï¼‰
# effect: NoExecuteï¼ˆä¸æ‰§è¡Œï¼Œé©±é€å·²æœ‰Podï¼‰
```

### 2.2 ä¸‰ç§æ±¡ç‚¹æ•ˆæœç±»å‹


#### ğŸš« NoScheduleï¼ˆä¸è°ƒåº¦ï¼‰


ğŸ’¡ **å«ä¹‰**ï¼šæ–°Podä¸èƒ½è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œä½†å·²æœ‰Podç»§ç»­è¿è¡Œ

```bash
# ç»™èŠ‚ç‚¹æ·»åŠ NoScheduleæ±¡ç‚¹
kubectl taint nodes node1 env=test:NoSchedule

å®é™…æ•ˆæœï¼š
â€¢ æ–°Podåˆ›å»ºæ—¶ä¸ä¼šé€‰æ‹©node1
â€¢ node1ä¸Šå·²ç»è¿è¡Œçš„Podç»§ç»­æ­£å¸¸å·¥ä½œ
â€¢ é€‚åˆï¼šèŠ‚ç‚¹èµ„æºç´§å¼ ï¼Œæš‚åœæ¥æ”¶æ–°Pod
```

#### ğŸƒ PreferNoScheduleï¼ˆå°½é‡ä¸è°ƒåº¦ï¼‰


ğŸ’¡ **å«ä¹‰**ï¼šå°½é‡é¿å…è°ƒåº¦ï¼Œä½†å®åœ¨æ²¡æœ‰å…¶ä»–èŠ‚ç‚¹æ—¶è¿˜æ˜¯ä¼šè°ƒåº¦è¿‡æ¥

```bash
# æ·»åŠ PreferNoScheduleæ±¡ç‚¹
kubectl taint nodes node2 disk=ssd:PreferNoSchedule

å®é™…æ•ˆæœï¼š
â€¢ ä¼˜å…ˆé€‰æ‹©å…¶ä»–èŠ‚ç‚¹
â€¢ å¦‚æœå…¶ä»–èŠ‚ç‚¹éƒ½ä¸æ»¡è¶³æ¡ä»¶ï¼Œè¿˜æ˜¯ä¼šè°ƒåº¦åˆ°node2
â€¢ é€‚åˆï¼šèŠ‚ç‚¹æ€§èƒ½ä¸€èˆ¬ï¼Œä¸æ˜¯é¦–é€‰ä½†å¯ä»¥ç”¨
```

#### ğŸ’¥ NoExecuteï¼ˆä¸æ‰§è¡Œï¼‰


ğŸ’¡ **å«ä¹‰**ï¼šæ–°Podä¸èƒ½è°ƒåº¦ï¼Œå·²æœ‰ä¸å®¹å¿çš„Podä¼šè¢«é©±é€

```bash
# æ·»åŠ NoExecuteæ±¡ç‚¹
kubectl taint nodes node3 maintenance=true:NoExecute

å®é™…æ•ˆæœï¼š
â€¢ æ–°Podä¸ä¼šè°ƒåº¦åˆ°node3
â€¢ node3ä¸Šä¸å®¹å¿æ­¤æ±¡ç‚¹çš„Podç«‹å³è¢«é©±é€
â€¢ é€‚åˆï¼šèŠ‚ç‚¹ç»´æŠ¤ï¼Œéœ€è¦æ¸…ç©ºèŠ‚ç‚¹
```

### 2.3 æ±¡ç‚¹æ“ä½œå‘½ä»¤


#### ğŸ“ æ·»åŠ æ±¡ç‚¹


```bash
# åŸºæœ¬è¯­æ³•
kubectl taint nodes <èŠ‚ç‚¹å> <key>=<value>:<effect>

# å®ä¾‹æ“ä½œ
kubectl taint nodes worker1 env=production:NoSchedule
kubectl taint nodes worker2 maintenance:NoExecute
kubectl taint nodes gpu-node gpu=v100:NoSchedule
```

#### ğŸ” æŸ¥çœ‹æ±¡ç‚¹


```bash
# æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹
kubectl describe nodes worker1 | grep -i taint

# æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„æ±¡ç‚¹ä¿¡æ¯
kubectl get nodes -o custom-columns=NAME:.metadata.name,TAINTS:.spec.taints
```

#### ğŸ—‘ï¸ åˆ é™¤æ±¡ç‚¹


```bash
# åˆ é™¤ç‰¹å®šæ±¡ç‚¹ï¼ˆkeyåé¢åŠ å‡å·ï¼‰
kubectl taint nodes worker1 env=production:NoSchedule-

# åˆ é™¤keyå¯¹åº”çš„æ‰€æœ‰æ±¡ç‚¹
kubectl taint nodes worker1 env-

# åˆ é™¤èŠ‚ç‚¹ä¸Šæ‰€æœ‰æ±¡ç‚¹
kubectl taint nodes worker1 --all-
```

---

## 3. ğŸ­ Tolerationså®¹å¿é…ç½®


### 3.1 å®¹å¿é…ç½®è¯­æ³•


ğŸ”¸ **Podä¸­çš„tolerationså­—æ®µ**ï¼š

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: test-pod
spec:
  tolerations:
  - key: "env"              # å¯¹åº”æ±¡ç‚¹çš„key
    operator: "Equal"       # åŒ¹é…æ–¹å¼
    value: "production"     # å¯¹åº”æ±¡ç‚¹çš„value
    effect: "NoSchedule"    # å¯¹åº”æ±¡ç‚¹çš„effect
  containers:
  - name: app
    image: nginx
```

### 3.2 å®¹å¿åŒ¹é…æ–¹å¼


#### âš–ï¸ Equalï¼ˆç²¾ç¡®åŒ¹é…ï¼‰


```yaml
tolerations:
- key: "env"
  operator: "Equal"
  value: "production"
  effect: "NoSchedule"

# è§£è¯»ï¼šèƒ½å®¹å¿ env=production:NoSchedule è¿™ä¸ªæ±¡ç‚¹
# å¿…é¡»keyã€valueã€effectéƒ½å®Œå…¨åŒ¹é…
```

#### ğŸ¯ Existsï¼ˆå­˜åœ¨æ€§åŒ¹é…ï¼‰


```yaml
# åŒ¹é…ç‰¹å®škeyçš„æ‰€æœ‰value
tolerations:
- key: "env"
  operator: "Exists"
  effect: "NoSchedule"

# è§£è¯»ï¼šèƒ½å®¹å¿æ‰€æœ‰ env=ä»»ä½•å€¼:NoSchedule çš„æ±¡ç‚¹
```

```yaml
# åŒ¹é…æ‰€æœ‰æ±¡ç‚¹ï¼ˆä¸‡èƒ½å®¹å¿ï¼‰
tolerations:
- operator: "Exists"

# è§£è¯»ï¼šå®¹å¿èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ±¡ç‚¹ï¼Œå¯ä»¥è°ƒåº¦åˆ°ä»»ä½•èŠ‚ç‚¹
```

### 3.3 ç‰¹æ®Šå®¹å¿é…ç½®


#### â° å¸¦å®¹å¿æ—¶é—´çš„é…ç½®


```yaml
tolerations:
- key: "maintenance"
  operator: "Equal"
  value: "true"
  effect: "NoExecute"
  tolerationSeconds: 300    # å®¹å¿5åˆ†é’Ÿ

# è§£è¯»ï¼š
# â€¢ Podå¯ä»¥åœ¨æœ‰maintenanceæ±¡ç‚¹çš„èŠ‚ç‚¹è¿è¡Œ
# â€¢ ä½†æœ€å¤šåªèƒ½å¾…5åˆ†é’Ÿï¼Œä¹‹åä¼šè¢«é©±é€
```

#### ğŸ”„ å¤šä¸ªå®¹å¿ç»„åˆ


```yaml
tolerations:
- key: "env"
  operator: "Equal"
  value: "production"
  effect: "NoSchedule"
- key: "node-type"
  operator: "Equal" 
  value: "gpu"
  effect: "NoSchedule"
- key: "maintenance"
  operator: "Exists"
  effect: "NoExecute"
  tolerationSeconds: 600

# è§£è¯»ï¼šè¿™ä¸ªPodå¾ˆ"å®½å®¹"ï¼Œèƒ½å®¹å¿å¤šç§æ±¡ç‚¹
```

---

## 4. ğŸ”— æ±¡ç‚¹å®¹å¿åŒ¹é…è§„åˆ™


### 4.1 åŒ¹é…è§„åˆ™è¯¦è§£


ğŸ“‹ **åŒ¹é…å¿…è¦æ¡ä»¶**ï¼š
1. **keyå¿…é¡»åŒ¹é…**ï¼ˆé™¤éå®¹å¿é…ç½®æ˜¯ä¸‡èƒ½åŒ¹é…ï¼‰
2. **effectå¿…é¡»åŒ¹é…**ï¼ˆé™¤éå®¹å¿é…ç½®çœç•¥effectï¼‰
3. **valueæŒ‰operatorè§„åˆ™åŒ¹é…**

### 4.2 åŒ¹é…æ¡ˆä¾‹åˆ†æ


ğŸŒ° **æ¡ˆä¾‹1ï¼šç²¾ç¡®åŒ¹é…**

```
èŠ‚ç‚¹æ±¡ç‚¹ï¼šenv=production:NoSchedule

âœ… èƒ½åŒ¹é…çš„å®¹å¿ï¼š
tolerations:
- key: "env"
  operator: "Equal"
  value: "production"
  effect: "NoSchedule"

âŒ ä¸èƒ½åŒ¹é…çš„å®¹å¿ï¼š
tolerations:
- key: "env"
  operator: "Equal"
  value: "test"           # valueä¸åŒ¹é…
  effect: "NoSchedule"
```

ğŸŒ° **æ¡ˆä¾‹2ï¼šå­˜åœ¨æ€§åŒ¹é…**

```
èŠ‚ç‚¹æ±¡ç‚¹ï¼šgpu=v100:NoSchedule

âœ… èƒ½åŒ¹é…çš„å®¹å¿ï¼š
tolerations:
- key: "gpu"
  operator: "Exists"      # ä¸å…³å¿ƒvalueå…·ä½“æ˜¯ä»€ä¹ˆ
  effect: "NoSchedule"

âœ… ä¹Ÿèƒ½åŒ¹é…ï¼š
tolerations:
- key: "gpu"
  operator: "Equal"
  value: "v100"
  effect: "NoSchedule"
```

### 4.3 ç‰¹æ®ŠåŒ¹é…æƒ…å†µ


#### ğŸ¯ Effectçœç•¥çš„æƒ…å†µ


```yaml
tolerations:
- key: "env"
  operator: "Equal"
  value: "production"
  # æ²¡æœ‰æŒ‡å®šeffect

# èƒ½åŒ¹é…ä»¥ä¸‹æ‰€æœ‰æ±¡ç‚¹ï¼š
# env=production:NoSchedule
# env=production:NoExecute  
# env=production:PreferNoSchedule
```

#### ğŸŒŸ ä¸‡èƒ½å®¹å¿


```yaml
tolerations:
- operator: "Exists"
# æ²¡æœ‰keyã€valueã€effecté™åˆ¶

# èƒ½å®¹å¿èŠ‚ç‚¹ä¸Šçš„ä»»ä½•æ±¡ç‚¹ï¼Œç›¸å½“äº"ä¸‡é‡‘æ²¹"Pod
```

---

## 5. ğŸ”§ èŠ‚ç‚¹ç»´æŠ¤åœºæ™¯åº”ç”¨


### 5.1 èŠ‚ç‚¹ç»´æŠ¤çš„å…¸å‹æµç¨‹


ğŸ“… **ç»´æŠ¤å‰å‡†å¤‡**ï¼š

```bash
# æ­¥éª¤1ï¼šæ ‡è®°èŠ‚ç‚¹ä¸ºä¸å¯è°ƒåº¦ï¼ˆcordoningï¼‰
kubectl cordon node1
# æ•ˆæœï¼šæ–°Podä¸ä¼šè°ƒåº¦åˆ°node1ï¼Œå·²æœ‰Podç»§ç»­è¿è¡Œ

# æ­¥éª¤2ï¼šä¸ºèŠ‚ç‚¹æ·»åŠ ç»´æŠ¤æ±¡ç‚¹
kubectl taint nodes node1 maintenance=scheduled:NoSchedule
# æ•ˆæœï¼šåŒé‡ä¿é™©ï¼Œç¡®ä¿æ–°Podä¸æ¥

# æ­¥éª¤3ï¼šé€æ­¥è¿ç§»Podï¼ˆdrainingï¼‰
kubectl drain node1 --ignore-daemonsets --delete-emptydir-data
# æ•ˆæœï¼šå·²æœ‰Podè¢«ä¼˜é›…åœ°è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹
```

### 5.2 ç´§æ€¥ç»´æŠ¤åœºæ™¯


ğŸš¨ **ç´§æ€¥æƒ…å†µå¤„ç†**ï¼š

```bash
# ç´§æ€¥ç»´æŠ¤ï¼šç«‹å³æ¸…ç©ºèŠ‚ç‚¹
kubectl taint nodes node1 emergency=hardware-failure:NoExecute

# æ•ˆæœï¼š
# â€¢ æ‰€æœ‰ä¸å®¹å¿æ­¤æ±¡ç‚¹çš„Podç«‹å³è¢«é©±é€
# â€¢ æ–°Podä¸ä¼šè°ƒåº¦è¿‡æ¥
# â€¢ é€‚åˆç¡¬ä»¶æ•…éšœç­‰ç´§æ€¥æƒ…å†µ
```

### 5.3 ç»´æŠ¤å®Œæˆåæ¢å¤


ğŸ”„ **æ¢å¤èŠ‚ç‚¹æ­£å¸¸çŠ¶æ€**ï¼š

```bash
# æ­¥éª¤1ï¼šç§»é™¤æ±¡ç‚¹
kubectl taint nodes node1 maintenance=scheduled:NoSchedule-

# æ­¥éª¤2ï¼šå–æ¶ˆä¸å¯è°ƒåº¦æ ‡è®°
kubectl uncordon node1

# æ­¥éª¤3ï¼šéªŒè¯èŠ‚ç‚¹çŠ¶æ€
kubectl describe nodes node1 | grep -i taint
# åº”è¯¥æ˜¾ç¤ºï¼š<none> æˆ–è€…åªæœ‰ç³»ç»Ÿé»˜è®¤æ±¡ç‚¹
```

### 5.4 éƒ¨åˆ†ç»´æŠ¤åœºæ™¯


ğŸ› ï¸ **å…è®¸ç‰¹å®šPodè¿è¡Œ**ï¼š

```yaml
# ç»´æŠ¤æœŸé—´åªå…è®¸ç›‘æ§Podè¿è¡Œ
apiVersion: v1
kind: Pod
metadata:
  name: monitoring-pod
spec:
  tolerations:
  - key: "maintenance"
    operator: "Equal"
    value: "scheduled"
    effect: "NoSchedule"
  - key: "maintenance"
    operator: "Equal"
    value: "scheduled"
    effect: "NoExecute"
    tolerationSeconds: 3600  # æœ€å¤šè¿è¡Œ1å°æ—¶
  containers:
  - name: monitor
    image: prometheus/node-exporter
```

---

## 6. ğŸ’¼ å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ


### 6.1 GPUèŠ‚ç‚¹ä¸“ç”¨é…ç½®


ğŸ® **åœºæ™¯**ï¼šGPUèŠ‚ç‚¹åªè·‘æœºå™¨å­¦ä¹ ä»»åŠ¡

**èŠ‚ç‚¹é…ç½®**ï¼š
```bash
# ä¸ºGPUèŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹
kubectl taint nodes gpu-node1 nvidia.com/gpu=present:NoSchedule
```

**MLä»»åŠ¡Podé…ç½®**ï¼š
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: ml-training
spec:
  tolerations:
  - key: "nvidia.com/gpu"
    operator: "Equal"
    value: "present"
    effect: "NoSchedule"
  nodeSelector:
    accelerator: nvidia-tesla-v100
  containers:
  - name: tensorflow
    image: tensorflow/tensorflow:latest-gpu
    resources:
      limits:
        nvidia.com/gpu: 1
```

### 6.2 MasterèŠ‚ç‚¹ä¿æŠ¤


ğŸ‘‘ **åœºæ™¯**ï¼šé˜²æ­¢ä¸šåŠ¡Podè°ƒåº¦åˆ°MasterèŠ‚ç‚¹

**ç³»ç»Ÿé»˜è®¤é…ç½®**ï¼š
```bash
# MasterèŠ‚ç‚¹é€šå¸¸å·²ç»æœ‰è¿™ä¸ªæ±¡ç‚¹
kubectl describe nodes master1 | grep Taint
# Taints: node-role.kubernetes.io/master:NoSchedule
```

**å…è®¸ç‰¹å®šç³»ç»ŸPodè¿è¡Œ**ï¼š
```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: system-monitor
spec:
  template:
    spec:
      tolerations:
      - key: "node-role.kubernetes.io/master"
        operator: "Exists"
        effect: "NoSchedule"
      containers:
      - name: monitor
        image: monitoring-agent:latest
```

### 6.3 åˆ†ç¯å¢ƒéš”ç¦»


ğŸ¢ **åœºæ™¯**ï¼šç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒèŠ‚ç‚¹éš”ç¦»

**ç”Ÿäº§èŠ‚ç‚¹é…ç½®**ï¼š
```bash
kubectl taint nodes prod-node1 env=production:NoSchedule
kubectl taint nodes prod-node2 env=production:NoSchedule
```

**ç”Ÿäº§åº”ç”¨Pod**ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: prod-app
spec:
  template:
    spec:
      tolerations:
      - key: "env"
        operator: "Equal"
        value: "production"
        effect: "NoSchedule"
      nodeSelector:
        env: production
      containers:
      - name: app
        image: myapp:prod
```

### 6.4 æœ€ä½³å®è·µå»ºè®®


ğŸ“š **å®ç”¨å»ºè®®**ï¼š

**1. æ±¡ç‚¹å‘½åè§„èŒƒ**
```bash
# å¥½çš„å‘½åæ–¹å¼
kubectl taint nodes node1 env=production:NoSchedule
kubectl taint nodes node1 node-type=gpu:NoSchedule
kubectl taint nodes node1 maintenance=hardware-upgrade:NoExecute

# é¿å…æ— æ„ä¹‰å‘½å
kubectl taint nodes node1 test:NoSchedule  # å¤ªæ¨¡ç³Š
kubectl taint nodes node1 abc123:NoSchedule  # æ— æ„ä¹‰
```

**2. å®¹å¿é…ç½®ç­–ç•¥**
```yaml
# æ¨èï¼šæ˜ç¡®æŒ‡å®šå®¹å¿èŒƒå›´
tolerations:
- key: "env"
  operator: "Equal"
  value: "production"
  effect: "NoSchedule"

# æ…ç”¨ï¼šä¸‡èƒ½å®¹å¿ä¼šè®©Podè°ƒåº¦åˆ°ä»»ä½•èŠ‚ç‚¹
tolerations:
- operator: "Exists"
```

**3. è¿ç»´æ“ä½œé¡ºåº**
```bash
# æ­£ç¡®çš„ç»´æŠ¤æµç¨‹
1. kubectl cordon node1          # åœæ­¢è°ƒåº¦
2. kubectl taint node1 ...       # æ·»åŠ æ±¡ç‚¹
3. kubectl drain node1 ...       # è¿ç§»Pod
4. # æ‰§è¡Œç»´æŠ¤æ“ä½œ
5. kubectl taint node1 ... -     # ç§»é™¤æ±¡ç‚¹
6. kubectl uncordon node1        # æ¢å¤è°ƒåº¦
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ Taintsæ±¡ç‚¹ï¼šç»™èŠ‚ç‚¹æ‰“"ç‰¹æ®Šæ ‡è®°"ï¼Œé˜»æ­¢æŸäº›Podè°ƒåº¦
ğŸ”¸ Tolerationså®¹å¿ï¼šPodå£°æ˜èƒ½"å¿å—"æŸäº›æ±¡ç‚¹
ğŸ”¸ ä¸‰ç§æ•ˆæœï¼šNoSchedule(ä¸è°ƒåº¦) / PreferNoSchedule(å°½é‡ä¸è°ƒåº¦) / NoExecute(é©±é€)
ğŸ”¸ åŒ¹é…è§„åˆ™ï¼škeyã€valueã€effectéƒ½è¦å¯¹åº”ä¸Š
ğŸ”¸ ä¸»è¦ç”¨é€”ï¼šèŠ‚ç‚¹ä¸“ç”¨åŒ–ã€ç¯å¢ƒéš”ç¦»ã€ç»´æŠ¤ç®¡ç†
```

### 7.2 å…³é”®æ“ä½œå‘½ä»¤


| æ“ä½œç±»å‹ | **å‘½ä»¤ç¤ºä¾‹** | **è¯´æ˜** |
|---------|------------|---------|
| ğŸ·ï¸ **æ·»åŠ æ±¡ç‚¹** | `kubectl taint nodes node1 env=prod:NoSchedule` | `ç»™èŠ‚ç‚¹æ‰“æ ‡è®°` |
| ğŸ” **æŸ¥çœ‹æ±¡ç‚¹** | `kubectl describe nodes node1` | `æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯` |
| ğŸ—‘ï¸ **åˆ é™¤æ±¡ç‚¹** | `kubectl taint nodes node1 env=prod:NoSchedule-` | `keyååŠ å‡å·åˆ é™¤` |
| ğŸš« **åœæ­¢è°ƒåº¦** | `kubectl cordon node1` | `èŠ‚ç‚¹ç»´æŠ¤å‰å‡†å¤‡` |
| ğŸ”„ **æ¢å¤è°ƒåº¦** | `kubectl uncordon node1` | `ç»´æŠ¤å®Œæˆåæ¢å¤` |
| ğŸ’§ **è¿ç§»Pod** | `kubectl drain node1 --ignore-daemonsets` | `ä¼˜é›…è¿ç§»å·²æœ‰Pod` |

### 7.3 å®ç”¨åœºæ™¯æ€»ç»“


**ğŸ¯ å¸¸è§åº”ç”¨åœºæ™¯**ï¼š

```
ä¸“ç”¨èŠ‚ç‚¹ï¼š
â€¢ GPUèŠ‚ç‚¹ä¸“é—¨è·‘AIä»»åŠ¡
â€¢ é«˜æ€§èƒ½èŠ‚ç‚¹è·‘å…³é”®ä¸šåŠ¡
â€¢ å­˜å‚¨èŠ‚ç‚¹è·‘æ•°æ®åº“åº”ç”¨

ç¯å¢ƒéš”ç¦»ï¼š
â€¢ ç”Ÿäº§ã€æµ‹è¯•ã€å¼€å‘ç¯å¢ƒåˆ†ç¦»
â€¢ ä¸åŒå›¢é˜Ÿçš„èµ„æºéš”ç¦»
â€¢ æ•æ„Ÿä¸šåŠ¡çš„å®‰å…¨éš”ç¦»

è¿ç»´ç®¡ç†ï¼š
â€¢ èŠ‚ç‚¹ç»´æŠ¤æ—¶çš„Podè¿ç§»
â€¢ ç¡¬ä»¶å‡çº§æ—¶çš„æœåŠ¡ä¿éšœ
â€¢ æ•…éšœèŠ‚ç‚¹çš„åº”æ€¥å¤„ç†
```

### 7.4 è®°å¿†è¦ç‚¹


ğŸ’¡ **ä¸€å¥è¯æ€»ç»“**ï¼šæ±¡ç‚¹æ˜¯èŠ‚ç‚¹çš„"æŒ‘å‰”æ€§æ ¼"ï¼Œå®¹å¿æ˜¯Podçš„"é€‚åº”èƒ½åŠ›"ï¼Œåªæœ‰é€‚åº”çš„Podæ‰èƒ½åœ¨æŒ‘å‰”çš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚

ğŸ”‘ **å…³é”®ç†è§£**ï¼š
- **æ±¡ç‚¹**ï¼šèŠ‚ç‚¹è¯´"æˆ‘åªè¦ç‰¹å®šçš„Pod"
- **å®¹å¿**ï¼šPodè¯´"æˆ‘èƒ½é€‚åº”è¿™ç§èŠ‚ç‚¹"
- **åŒ¹é…**ï¼šåŒæ–¹"çœ‹å¯¹çœ¼"äº†æ‰èƒ½åœ¨ä¸€èµ·
- **ç»´æŠ¤**ï¼šä¸´æ—¶è®©èŠ‚ç‚¹"æ›´æŒ‘å‰”"ï¼Œç»´æŠ¤å®Œæ¢å¤"éšå’Œ"

ğŸ“Œ **æ“ä½œè®°å¿†**ï¼š
- **åŠ æ±¡ç‚¹**ï¼š`taint nodes èŠ‚ç‚¹ key=value:effect`
- **åˆ æ±¡ç‚¹**ï¼š`taint nodes èŠ‚ç‚¹ key=value:effect-`ï¼ˆæœ«å°¾åŠ å‡å·ï¼‰
- **çœ‹æ±¡ç‚¹**ï¼š`describe nodes èŠ‚ç‚¹`
- **åœè°ƒåº¦**ï¼š`cordon` â†’ **æ¢è°ƒåº¦**ï¼š`uncordon`

**æ ¸å¿ƒä»·å€¼**ï¼šè®©é›†ç¾¤èµ„æºä½¿ç”¨æ›´ç²¾å‡†ï¼ŒèŠ‚ç‚¹åŠŸèƒ½æ›´ä¸“ä¸€ï¼Œè¿ç»´ç®¡ç†æ›´çµæ´»ï¼