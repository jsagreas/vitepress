---
title: 3ã€é«˜å¯ç”¨æ¶æ„è®¾è®¡
---
## ğŸ“š ç›®å½•


1. [é«˜å¯ç”¨æ¶æ„åŸºæœ¬æ¦‚å¿µ](#1-é«˜å¯ç”¨æ¶æ„åŸºæœ¬æ¦‚å¿µ)
2. [Masteré«˜å¯ç”¨éƒ¨ç½²](#2-Masteré«˜å¯ç”¨éƒ¨ç½²)
3. [etcdé«˜å¯ç”¨é›†ç¾¤](#3-etcdé«˜å¯ç”¨é›†ç¾¤)
4. [è´Ÿè½½å‡è¡¡é…ç½®](#4-è´Ÿè½½å‡è¡¡é…ç½®)
5. [æ•…éšœè½¬ç§»æœºåˆ¶](#5-æ•…éšœè½¬ç§»æœºåˆ¶)
6. [æ•°æ®ä¸€è‡´æ€§ä¿éšœ](#6-æ•°æ®ä¸€è‡´æ€§ä¿éšœ)
7. [åˆ†åŒºå®¹é”™å¤„ç†](#7-åˆ†åŒºå®¹é”™å¤„ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# 1. ğŸ—ï¸ é«˜å¯ç”¨æ¶æ„åŸºæœ¬æ¦‚å¿µ



## 1.1 ä»€ä¹ˆæ˜¯é«˜å¯ç”¨æ¶æ„



**ğŸ¯ é€šä¿—ç†è§£**
é«˜å¯ç”¨å°±åƒæ˜¯ç»™ä½ çš„é‡è¦ç³»ç»Ÿé…å¤‡"å¤šé‡ä¿é™©"ï¼Œç¡®ä¿å³ä½¿æŸäº›éƒ¨ä»¶å‡ºæ•…éšœäº†ï¼Œæ•´ä¸ªç³»ç»Ÿè¿˜èƒ½æ­£å¸¸å·¥ä½œã€‚

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**
> å°±åƒåŒ»é™¢çš„å¤‡ç”¨ç”µæºç³»ç»Ÿï¼š
> - ä¸»ç”µæºæ­£å¸¸æ—¶ï¼ŒåŒ»é™¢ç”¨å¸‚ç”µ
> - ä¸»ç”µæºæ–­äº†ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨å‘ç”µæœº
> - å‘ç”µæœºä¹Ÿåäº†ï¼Œè¿˜æœ‰UPSç”µæ± åº”æ€¥
> - ç¡®ä¿ç—…äººçš„ç”Ÿå‘½æ”¯æŒè®¾å¤‡æ°¸ä¸æ–­ç”µ

**æ ¸å¿ƒç‰¹å¾**ï¼š
```
å¯ç”¨æ€§ç›®æ ‡ï¼š
ğŸ”´ 99.9%  â†’ æ¯å¹´å®•æœº8.76å°æ—¶  â†’ åŸºç¡€è¦æ±‚
ğŸŸ¡ 99.99% â†’ æ¯å¹´å®•æœº52.6åˆ†é’Ÿ â†’ ç”Ÿäº§æ¨è
ğŸŸ¢ 99.999% â†’ æ¯å¹´å®•æœº5.26åˆ†é’Ÿ â†’ æé«˜è¦æ±‚

å®ç°æ–¹å¼ï¼š
â€¢ å†—ä½™è®¾è®¡ï¼šå…³é”®ç»„ä»¶å¤šå‰¯æœ¬éƒ¨ç½²
â€¢ æ•…éšœæ£€æµ‹ï¼šå¿«é€Ÿå‘ç°ç»„ä»¶å¼‚å¸¸
â€¢ è‡ªåŠ¨åˆ‡æ¢ï¼šæ•…éšœæ—¶è‡ªåŠ¨è¿ç§»æœåŠ¡
â€¢ æ•°æ®ä¿æŠ¤ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±å’ŒæŸå
```

## 1.2 Kubernetesé«˜å¯ç”¨æ¶æ„æ€»è§ˆ



**ğŸ¢ æ•´ä½“æ¶æ„å›¾ç¤º**
```
                    å¤–éƒ¨ç”¨æˆ·/å®¢æˆ·ç«¯
                          â†“
                    [è´Ÿè½½å‡è¡¡å™¨]
                    /      |      \
                   â†“       â†“       â†“
            [Master1] [Master2] [Master3]  â† Masteré«˜å¯ç”¨
                \       |       /
                 \      |      /
                  [etcdé›†ç¾¤]              â† æ•°æ®å­˜å‚¨é«˜å¯ç”¨
                       â†“
                [WorkerèŠ‚ç‚¹é›†ç¾¤]          â† å·¥ä½œè´Ÿè½½é«˜å¯ç”¨
```

**ğŸ” æ¶æ„åˆ†å±‚è§£æ**ï¼š

**æ¥å…¥å±‚**ï¼šè´Ÿè½½å‡è¡¡å™¨åˆ†å‘è¯·æ±‚
- é¿å…å•ç‚¹æ•…éšœ
- æä¾›ç»Ÿä¸€å…¥å£
- æ”¯æŒå¥åº·æ£€æŸ¥

**æ§åˆ¶å¹³é¢**ï¼šå¤šä¸ªMasterèŠ‚ç‚¹
- API Serveré«˜å¯ç”¨
- è°ƒåº¦å™¨å†—ä½™éƒ¨ç½²
- æ§åˆ¶å™¨ç®¡ç†å™¨å¤‡ä»½

**æ•°æ®å±‚**ï¼šetcdé›†ç¾¤
- åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨
- Raftå…±è¯†ç®—æ³•
- æ•°æ®å¼ºä¸€è‡´æ€§

**è®¡ç®—å±‚**ï¼šWorkerèŠ‚ç‚¹é›†ç¾¤
- Podå‰¯æœ¬åˆ†å¸ƒ
- èŠ‚ç‚¹æ•…éšœæ¢å¤
- è‡ªåŠ¨æ‰©ç¼©å®¹

---

# 2. ğŸ¯ Masteré«˜å¯ç”¨éƒ¨ç½²



## 2.1 Masterç»„ä»¶é«˜å¯ç”¨åŸç†



**ğŸ§  æ ¸å¿ƒæ€è·¯**
MasterèŠ‚ç‚¹å°±åƒæ˜¯ä¼ä¸šçš„ç®¡ç†å±‚ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ª"ç»ç†"ï¼Œç»ç†ç”Ÿç—…äº†æ•´ä¸ªå›¢é˜Ÿå°±ç˜«ç—ªã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤šä¸ª"ç»ç†"ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªåœ¨å®é™…åšå†³ç­–ã€‚

**Masterç»„ä»¶åˆ†æ**ï¼š
```
API Serverï¼š
â€¢ æ— çŠ¶æ€ç»„ä»¶ï¼Œå¯ä»¥å¤šä¸ªåŒæ—¶è¿è¡Œ
â€¢ é€šè¿‡è´Ÿè½½å‡è¡¡å™¨åˆ†å‘è¯·æ±‚
â€¢ æ¯ä¸ªå®ä¾‹ç‹¬ç«‹å¤„ç†è¯·æ±‚

Controller Managerï¼š
â€¢ æœ‰çŠ¶æ€ç»„ä»¶ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªå·¥ä½œ
â€¢ é€šè¿‡Leaderé€‰ä¸¾æœºåˆ¶é˜²å†²çª
â€¢ å…¶ä»–å®ä¾‹å¤„äºçƒ­å¤‡çŠ¶æ€

Schedulerï¼š
â€¢ æœ‰çŠ¶æ€ç»„ä»¶ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªå·¥ä½œ
â€¢ åŒæ ·ä½¿ç”¨Leaderé€‰ä¸¾
â€¢ ç¡®ä¿è°ƒåº¦å†³ç­–çš„ä¸€è‡´æ€§

etcdï¼š
â€¢ é›†ç¾¤æ¨¡å¼éƒ¨ç½²
â€¢ ä½¿ç”¨Raftç®—æ³•ä¿è¯æ•°æ®ä¸€è‡´æ€§
â€¢ éœ€è¦å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼ˆ3/5/7ï¼‰
```

## 2.2 Masteré«˜å¯ç”¨éƒ¨ç½²æ­¥éª¤



### ğŸ”§ ç¯å¢ƒå‡†å¤‡



**èŠ‚ç‚¹è§„åˆ’**ï¼š
```
èŠ‚ç‚¹è§’è‰²åˆ†é…ï¼š

MasterèŠ‚ç‚¹ï¼ˆæ§åˆ¶å¹³é¢ï¼‰ï¼š
â€¢ k8s-master-01: 192.168.1.10
â€¢ k8s-master-02: 192.168.1.11  
â€¢ k8s-master-03: 192.168.1.12

WorkerèŠ‚ç‚¹ï¼ˆå·¥ä½œè´Ÿè½½ï¼‰ï¼š
â€¢ k8s-worker-01: 192.168.1.20
â€¢ k8s-worker-02: 192.168.1.21
â€¢ k8s-worker-03: 192.168.1.22

è´Ÿè½½å‡è¡¡å™¨ï¼š
â€¢ k8s-lb: 192.168.1.100 (VIPè™šæ‹ŸIP)
```

**ç¡¬ä»¶è¦æ±‚**ï¼š
| ç»„ä»¶ | **CPU** | **å†…å­˜** | **å­˜å‚¨** | **ç½‘ç»œ** |
|------|---------|----------|----------|----------|
| MasterèŠ‚ç‚¹ | `2æ ¸ä»¥ä¸Š` | `4GBä»¥ä¸Š` | `50GB` | `åƒå…†ç½‘å¡` |
| WorkerèŠ‚ç‚¹ | `2æ ¸ä»¥ä¸Š` | `4GBä»¥ä¸Š` | `100GB` | `åƒå…†ç½‘å¡` |
| etcdèŠ‚ç‚¹ | `2æ ¸ä»¥ä¸Š` | `8GBä»¥ä¸Š` | `SSD 50GB` | `ä½å»¶è¿Ÿç½‘ç»œ` |

### âš™ï¸ ç¬¬ä¸€ä¸ªMasterèŠ‚ç‚¹åˆå§‹åŒ–



```bash
# 1. åˆå§‹åŒ–ç¬¬ä¸€ä¸ªMasterèŠ‚ç‚¹

kubeadm init \
  --control-plane-endpoint="k8s-lb:6443" \
  --upload-certs \
  --pod-network-cidr=10.244.0.0/16

# å…³é”®å‚æ•°è§£é‡Šï¼š

# --control-plane-endpoint: è´Ÿè½½å‡è¡¡å™¨åœ°å€

# --upload-certs: è‡ªåŠ¨åˆ†å‘è¯ä¹¦åˆ°å…¶ä»–Master

# --pod-network-cidr: Podç½‘ç»œåœ°å€æ®µ

```

**ğŸ¯ åˆå§‹åŒ–æˆåŠŸåçš„é‡è¦ä¿¡æ¯**ï¼š
```
åˆå§‹åŒ–å®Œæˆåä¼šæ˜¾ç¤ºï¼š

1. kubeconfigé…ç½®å‘½ä»¤ï¼š
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config

2. MasterèŠ‚ç‚¹åŠ å…¥å‘½ä»¤ï¼š
kubeadm join k8s-lb:6443 --token xxx \
  --discovery-token-ca-cert-hash sha256:xxx \
  --control-plane --certificate-key xxx

3. WorkerèŠ‚ç‚¹åŠ å…¥å‘½ä»¤ï¼š
kubeadm join k8s-lb:6443 --token xxx \
  --discovery-token-ca-cert-hash sha256:xxx
```

### ğŸ”— æ·»åŠ å…¶ä»–MasterèŠ‚ç‚¹



```bash
# åœ¨ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªMasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œ

kubeadm join k8s-lb:6443 \
  --token [token] \
  --discovery-token-ca-cert-hash sha256:[hash] \
  --control-plane \
  --certificate-key [certificate-key]

# é…ç½®kubectl

mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
```

## 2.3 éªŒè¯Masteré«˜å¯ç”¨



**ğŸ§ª é›†ç¾¤çŠ¶æ€æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€

kubectl get nodes -o wide

# æœŸæœ›è¾“å‡ºï¼š

NAME            STATUS   ROLES           AGE   VERSION
k8s-master-01   Ready    control-plane   10m   v1.28.0
k8s-master-02   Ready    control-plane   8m    v1.28.0  
k8s-master-03   Ready    control-plane   6m    v1.28.0

# æŸ¥çœ‹ç»„ä»¶çŠ¶æ€

kubectl get pods -n kube-system

# å…³é”®ç»„ä»¶åº”è¯¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼š

# - kube-apiserver (3ä¸ª)

# - kube-controller-manager (3ä¸ªï¼Œä½†åªæœ‰1ä¸ªLeader)

# - kube-scheduler (3ä¸ªï¼Œä½†åªæœ‰1ä¸ªLeader)

# - etcd (3ä¸ª)

```

---

# 3. ğŸ’¾ etcdé«˜å¯ç”¨é›†ç¾¤



## 3.1 etcdåŸºç¡€æ¦‚å¿µ



**ğŸ“š ä»€ä¹ˆæ˜¯etcd**
etcdå°±åƒæ˜¯Kubernetesçš„"å¤§è„‘è®°å¿†åº“"ï¼Œå­˜å‚¨ç€é›†ç¾¤çš„æ‰€æœ‰é‡è¦ä¿¡æ¯ã€‚å¦‚æœetcdå‡ºé—®é¢˜ï¼Œæ•´ä¸ªé›†ç¾¤å°±ä¼š"å¤±å¿†"ã€‚

> ğŸ§  **è®°å¿†ç±»æ¯”**
> etcdå°±åƒäººçš„é•¿æœŸè®°å¿†ï¼š
> - å­˜å‚¨æ‰€æœ‰é‡è¦ä¿¡æ¯ï¼ˆPodå®šä¹‰ã€é…ç½®ç­‰ï¼‰
> - å¿…é¡»ä¿è¯ä¿¡æ¯ä¸ä¸¢å¤±
> - å¤šä¸ª"è®°å¿†å‰¯æœ¬"é˜²æ­¢é—å¿˜
> - æ‰€æœ‰å‰¯æœ¬ä¿¡æ¯å¿…é¡»ä¿æŒä¸€è‡´

**etcdå­˜å‚¨çš„å…³é”®æ•°æ®**ï¼š
```
é›†ç¾¤çŠ¶æ€ä¿¡æ¯ï¼š
â€¢ æ‰€æœ‰Podã€Serviceã€Deploymentç­‰å¯¹è±¡å®šä¹‰
â€¢ èŠ‚ç‚¹ä¿¡æ¯å’Œå¥åº·çŠ¶æ€  
â€¢ ç½‘ç»œé…ç½®å’Œç­–ç•¥
â€¢ RBACæƒé™é…ç½®
â€¢ æ‰€æœ‰ConfigMapå’ŒSecret

é…ç½®ä¿¡æ¯ï¼š
â€¢ é›†ç¾¤å‚æ•°è®¾ç½®
â€¢ ç»„ä»¶é…ç½®
â€¢ ç”¨æˆ·è‡ªå®šä¹‰èµ„æº(CRD)
```

## 3.2 etcdé›†ç¾¤éƒ¨ç½²æ¨¡å¼



### ğŸ—ï¸ éƒ¨ç½²æ¶æ„é€‰æ‹©



**æ¨¡å¼ä¸€ï¼šåµŒå…¥å¼éƒ¨ç½²ï¼ˆæ¨èæ–°æ‰‹ï¼‰**
```
æ¯ä¸ªMasterèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªetcdå®ä¾‹

ä¼˜ç‚¹ï¼š
âœ… éƒ¨ç½²ç®€å•ï¼Œkubeadmè‡ªåŠ¨é…ç½®
âœ… ç½‘ç»œå»¶è¿Ÿä½ï¼Œetcdå’ŒAPI Serveråœ¨åŒä¸€èŠ‚ç‚¹
âœ… èµ„æºåˆ©ç”¨ç‡é«˜

ç¼ºç‚¹ï¼š
âŒ etcdå’ŒMasterèŠ‚ç‚¹è€¦åˆåº¦é«˜
âŒ èŠ‚ç‚¹æ•…éšœå½±å“é¢å¤§
```

**æ¨¡å¼äºŒï¼šç‹¬ç«‹é›†ç¾¤éƒ¨ç½²ï¼ˆæ¨èç”Ÿäº§ï¼‰**
```
ç‹¬ç«‹çš„etcdé›†ç¾¤ï¼Œä¸MasterèŠ‚ç‚¹åˆ†ç¦»

ä¼˜ç‚¹ï¼š
âœ… èŒè´£åˆ†ç¦»ï¼Œä¾¿äºè¿ç»´ç®¡ç†
âœ… å¯ä»¥ç‹¬ç«‹æ‰©å®¹å’Œç»´æŠ¤
âœ… æ•…éšœå½±å“èŒƒå›´å¯æ§

ç¼ºç‚¹ï¼š
âŒ éƒ¨ç½²å¤æ‚åº¦é«˜
âŒ ç½‘ç»œå»¶è¿Ÿç›¸å¯¹è¾ƒé«˜
âŒ éœ€è¦æ›´å¤šæœåŠ¡å™¨èµ„æº
```

### âš™ï¸ åµŒå…¥å¼etcdé«˜å¯ç”¨é…ç½®



å½“ä½¿ç”¨kubeadméƒ¨ç½²æ—¶ï¼Œetcdä¼šè‡ªåŠ¨é…ç½®ä¸ºé›†ç¾¤æ¨¡å¼ï¼š

```yaml
# /etc/kubernetes/manifests/etcd.yaml å…³é”®é…ç½®

spec:
  containers:
  - name: etcd
    image: registry.k8s.io/etcd:3.5.9-0
    command:
    - etcd
    - --name=k8s-master-01                    # èŠ‚ç‚¹åç§°
    - --initial-cluster=k8s-master-01=https://192.168.1.10:2380,k8s-master-02=https://192.168.1.11:2380,k8s-master-03=https://192.168.1.12:2380
    - --initial-cluster-state=existing        # é›†ç¾¤çŠ¶æ€
    - --listen-peer-urls=https://0.0.0.0:2380 # é›†ç¾¤é€šä¿¡åœ°å€
    - --listen-client-urls=https://0.0.0.0:2379 # å®¢æˆ·ç«¯è¿æ¥åœ°å€
```

## 3.3 etcdé›†ç¾¤å¥åº·æ£€æŸ¥



**ğŸ©º é›†ç¾¤çŠ¶æ€è¯Šæ–­**ï¼š

```bash
# è¿›å…¥etcdå®¹å™¨æ£€æŸ¥é›†ç¾¤çŠ¶æ€

kubectl exec -it etcd-k8s-master-01 -n kube-system -- etcdctl \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key \
  endpoint health

# æœŸæœ›è¾“å‡ºï¼š

https://192.168.1.10:2379 is healthy: successfully committed proposal
https://192.168.1.11:2379 is healthy: successfully committed proposal  
https://192.168.1.12:2379 is healthy: successfully committed proposal

# æŸ¥çœ‹é›†ç¾¤æˆå‘˜

kubectl exec -it etcd-k8s-master-01 -n kube-system -- etcdctl \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key \
  member list
```

---

# 4. âš–ï¸ è´Ÿè½½å‡è¡¡é…ç½®



## 4.1 è´Ÿè½½å‡è¡¡çš„ä½œç”¨



**ğŸš¦ æµé‡åˆ†å‘ç®¡ç†**
è´Ÿè½½å‡è¡¡å™¨å°±åƒäº¤é€šè­¦å¯Ÿï¼ŒæŠŠæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚åˆç†åˆ†é…ç»™å¤šä¸ªMasterèŠ‚ç‚¹ï¼Œç¡®ä¿æ²¡æœ‰å•ä¸ªèŠ‚ç‚¹è¿‡è½½ã€‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
```
è¯·æ±‚åˆ†å‘ï¼š
â€¢ å°†å®¢æˆ·ç«¯è¯·æ±‚åˆ†å‘åˆ°å¥åº·çš„MasterèŠ‚ç‚¹
â€¢ æ”¯æŒå¤šç§åˆ†å‘ç®—æ³•ï¼ˆè½®è¯¢ã€æœ€å°‘è¿æ¥ç­‰ï¼‰
â€¢ é¿å…å•ä¸ªèŠ‚ç‚¹è¿‡è½½

å¥åº·æ£€æŸ¥ï¼š
â€¢ å®šæœŸæ£€æµ‹MasterèŠ‚ç‚¹å¥åº·çŠ¶æ€
â€¢ è‡ªåŠ¨å‰”é™¤æ•…éšœèŠ‚ç‚¹
â€¢ æ•…éšœæ¢å¤åè‡ªåŠ¨åŠ å›

é«˜å¯ç”¨ï¼š
â€¢ è‡ªèº«ä¹Ÿéœ€è¦é«˜å¯ç”¨éƒ¨ç½²
â€¢ æä¾›è™šæ‹ŸIP(VIP)ç»Ÿä¸€å…¥å£
â€¢ æ”¯æŒä¸»å¤‡åˆ‡æ¢
```

## 4.2 å¸¸ç”¨è´Ÿè½½å‡è¡¡æ–¹æ¡ˆ



### ğŸ”§ æ–¹æ¡ˆä¸€ï¼šHAProxy + Keepalived



**æ¶æ„å›¾ç¤º**ï¼š
```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
[VIP: 192.168.1.100]
    â†“
[HAProxyä¸»] â†â†’ [HAProxyå¤‡]  (Keepalivedç®¡ç†)
    â†“
åˆ†å‘åˆ°MasterèŠ‚ç‚¹
192.168.1.10:6443
192.168.1.11:6443  
192.168.1.12:6443
```

**HAProxyé…ç½®ç¤ºä¾‹**ï¼š
```bash
# /etc/haproxy/haproxy.cfg

global
    log 127.0.0.1:514 local0
    chroot /var/lib/haproxy
    stats socket /run/haproxy/admin.sock mode 660
    user haproxy
    group haproxy

defaults
    mode http
    log global
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

# Kubernetes API Serverè´Ÿè½½å‡è¡¡

frontend k8s-api
    bind *:6443
    mode tcp
    default_backend k8s-api-servers

backend k8s-api-servers
    mode tcp
    balance roundrobin                    # è½®è¯¢ç®—æ³•
    option tcp-check
    server master1 192.168.1.10:6443 check
    server master2 192.168.1.11:6443 check
    server master3 192.168.1.12:6443 check
```

**Keepalivedé…ç½®ç¤ºä¾‹**ï¼š
```bash
# /etc/keepalived/keepalived.conf (ä¸»èŠ‚ç‚¹)

vrrp_instance VI_1 {
    state MASTER                         # ä¸»èŠ‚ç‚¹
    interface eth0
    virtual_router_id 51
    priority 100                         # ä¼˜å…ˆçº§
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass k8s-ha-pass
    }
    virtual_ipaddress {
        192.168.1.100                    # è™šæ‹ŸIP
    }
}
```

### ğŸŒ æ–¹æ¡ˆäºŒï¼šäº‘å‚å•†è´Ÿè½½å‡è¡¡



**äº‘ç¯å¢ƒæ¨èé…ç½®**ï¼š
```
é˜¿é‡Œäº‘SLBé…ç½®ï¼š
â€¢ ç›‘å¬ç«¯å£ï¼š6443
â€¢ åè®®ï¼šTCP
â€¢ è°ƒåº¦ç®—æ³•ï¼šè½®è¯¢
â€¢ å¥åº·æ£€æŸ¥ï¼šTCPç«¯å£æ£€æŸ¥
â€¢ åç«¯æœåŠ¡å™¨ï¼š3ä¸ªMasterèŠ‚ç‚¹

è…¾è®¯äº‘CLBé…ç½®ï¼š
â€¢ ç½‘ç»œç±»å‹ï¼šå†…ç½‘
â€¢ åè®®ï¼šTCP
â€¢ ç«¯å£ï¼š6443  
â€¢ å‡è¡¡æ–¹å¼ï¼šè½®è¯¢
â€¢ å¥åº·æ£€æŸ¥é—´éš”ï¼š5ç§’
```

## 4.3 è´Ÿè½½å‡è¡¡éªŒè¯



**ğŸ§ª è¿æ¥æµ‹è¯•**ï¼š

```bash
# æµ‹è¯•API Serverè¿æ¥

kubectl --server=https://192.168.1.100:6443 get nodes

# å¤šæ¬¡æ‰§è¡Œï¼Œè§‚å¯Ÿæ˜¯å¦æ­£å¸¸è½®è¯¢

for i in {1..10}; do
  kubectl --server=https://192.168.1.100:6443 get nodes --v=6 2>&1 | grep "GET https"
done

# å…³é—­ä¸€ä¸ªMasterèŠ‚ç‚¹ï¼Œæµ‹è¯•æ•…éšœè½¬ç§»

systemctl stop kubelet
# è§‚å¯Ÿè´Ÿè½½å‡è¡¡å™¨æ˜¯å¦è‡ªåŠ¨å‰”é™¤æ•…éšœèŠ‚ç‚¹

```

---

# 5. ğŸ”„ æ•…éšœè½¬ç§»æœºåˆ¶



## 5.1 æ•…éšœè½¬ç§»åŸºæœ¬åŸç†



**ğŸš¨ è‡ªåŠ¨æ•…éšœå¤„ç†**
æ•…éšœè½¬ç§»å°±åƒæ˜¯ç³»ç»Ÿçš„"è‡ªæ„ˆèƒ½åŠ›"ï¼Œå½“æ£€æµ‹åˆ°ç»„ä»¶æ•…éšœæ—¶ï¼Œè‡ªåŠ¨å¯åŠ¨å¤‡ç”¨ç»„ä»¶æˆ–è¿ç§»æœåŠ¡åˆ°å¥åº·èŠ‚ç‚¹ã€‚

**æ•…éšœè½¬ç§»å±‚æ¬¡**ï¼š
```
ç»„ä»¶çº§æ•…éšœè½¬ç§»ï¼š
â€¢ Controller Manager Leaderé€‰ä¸¾
â€¢ Scheduler Leaderé€‰ä¸¾
â€¢ API Serverè´Ÿè½½å‡è¡¡åˆ‡æ¢

èŠ‚ç‚¹çº§æ•…éšœè½¬ç§»ï¼š
â€¢ Podé‡æ–°è°ƒåº¦åˆ°å¥åº·èŠ‚ç‚¹
â€¢ å­˜å‚¨å·è¿ç§»
â€¢ ç½‘ç»œè·¯ç”±æ›´æ–°

é›†ç¾¤çº§æ•…éšœè½¬ç§»ï¼š
â€¢ è·¨å¯ç”¨åŒºéƒ¨ç½²
â€¢ å¤šé›†ç¾¤è”é‚¦
â€¢ ç¾å¤‡æ¢å¤
```

## 5.2 Controller Manageræ•…éšœè½¬ç§»



**ğŸ­ Leaderé€‰ä¸¾æœºåˆ¶**

Controller Managerä½¿ç”¨Leaderé€‰ä¸¾ç¡®ä¿åŒæ—¶åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨å·¥ä½œï¼š

```yaml
# Leaderé€‰ä¸¾é…ç½®

spec:
  containers:
  - name: kube-controller-manager
    command:
    - kube-controller-manager
    - --leader-elect=true                    # å¯ç”¨Leaderé€‰ä¸¾
    - --leader-elect-lease-duration=15s      # ç§Ÿçº¦æŒç»­æ—¶é—´
    - --leader-elect-renew-deadline=10s      # ç»­çº¦æˆªæ­¢æ—¶é—´
    - --leader-elect-retry-period=2s         # é‡è¯•é—´éš”
```

**é€‰ä¸¾è¿‡ç¨‹è¯´æ˜**ï¼š
```
æ­¥éª¤1ï¼šç«äº‰Leader
â€¢ æ‰€æœ‰Controller Managerå®ä¾‹å°è¯•è·å–åˆ†å¸ƒå¼é”
â€¢ ä½¿ç”¨etcdçš„åŸå­æ“ä½œä¿è¯å”¯ä¸€æ€§
â€¢ è·å¾—é”çš„å®ä¾‹æˆä¸ºLeader

æ­¥éª¤2ï¼šç»´æŒLeaderåœ°ä½
â€¢ Leaderå®šæœŸç»­çº¦ï¼Œè¯æ˜è‡ªå·±è¿˜æ´»ç€
â€¢ ç»­çº¦å¤±è´¥ï¼Œå…¶ä»–å®ä¾‹å¼€å§‹æ–°ä¸€è½®é€‰ä¸¾
â€¢ ç¡®ä¿å§‹ç»ˆæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªLeaderå·¥ä½œ

æ­¥éª¤3ï¼šæ•…éšœè‡ªåŠ¨åˆ‡æ¢
â€¢ Leaderæ•…éšœï¼Œåœæ­¢ç»­çº¦
â€¢ å…¶ä»–å®ä¾‹æ£€æµ‹åˆ°è¶…æ—¶ï¼Œå¼€å§‹ç«é€‰
â€¢ æ–°Leaderæ¥ç®¡ï¼Œç»§ç»­æ§åˆ¶å™¨å·¥ä½œ
```

## 5.3 Podæ•…éšœè½¬ç§»



**âš•ï¸ è‡ªåŠ¨é‡æ–°è°ƒåº¦**

å½“èŠ‚ç‚¹æ•…éšœæ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨é‡æ–°è°ƒåº¦Podï¼š

```bash
# æ¨¡æ‹ŸèŠ‚ç‚¹æ•…éšœ

kubectl drain k8s-worker-01 --ignore-daemonsets --force

# è§‚å¯ŸPodé‡æ–°è°ƒåº¦è¿‡ç¨‹

kubectl get pods -o wide --watch

# PodçŠ¶æ€å˜åŒ–ï¼š

# Running â†’ Terminating â†’ Pending â†’ Running(æ–°èŠ‚ç‚¹)

```

**é‡è¦é…ç½®å‚æ•°**ï¼š
```yaml
# èŠ‚ç‚¹æ•…éšœå®¹å¿æ—¶é—´

spec:
  tolerations:
  - key: "node.kubernetes.io/not-ready"
    operator: "Exists"
    effect: "NoExecute"
    tolerationSeconds: 300              # 5åˆ†é’Ÿåè¿ç§»

  - key: "node.kubernetes.io/unreachable"  
    operator: "Exists"
    effect: "NoExecute" 
    tolerationSeconds: 300
```

## 5.4 å­˜å‚¨æ•…éšœè½¬ç§»



**ğŸ’¾ æŒä¹…åŒ–å·è¿ç§»**

```yaml
# PVCé…ç½®æ”¯æŒè·¨èŠ‚ç‚¹è¿ç§»

apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: web-pvc
spec:
  accessModes:
  - ReadWriteOnce
  storageClassName: fast-ssd
  resources:
    requests:
      storage: 10Gi

---
# Deploymentä½¿ç”¨PVC

apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: web-app
  template:
    spec:
      containers:
      - name: web
        image: nginx
        volumeMounts:
        - name: web-storage
          mountPath: /data
      volumes:
      - name: web-storage
        persistentVolumeClaim:
          claimName: web-pvc
```

---

# 6. ğŸ”’ æ•°æ®ä¸€è‡´æ€§ä¿éšœ



## 6.1 etcdæ•°æ®ä¸€è‡´æ€§



**ğŸ“Š Raftå…±è¯†ç®—æ³•**

etcdä½¿ç”¨Raftç®—æ³•ä¿è¯å¤šä¸ªèŠ‚ç‚¹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼š

> ğŸ—³ï¸ **é€‰ä¸¾ç±»æ¯”**
> Raftç®—æ³•å°±åƒæ°‘ä¸»é€‰ä¸¾ï¼š
> - æœ‰ä¸€ä¸ªLeaderè´Ÿè´£å¤„ç†æ‰€æœ‰å†™æ“ä½œ
> - Leaderå°†å˜æ›´å¤åˆ¶ç»™æ‰€æœ‰Follower
> - è¶…è¿‡åŠæ•°Followerç¡®è®¤åï¼Œå˜æ›´æ‰ç”Ÿæ•ˆ
> - Leaderæ•…éšœæ—¶ï¼ŒFollowerä»¬é‡æ–°é€‰ä¸¾æ–°Leader

**Raftç®—æ³•æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
è§’è‰²åˆ†ç±»ï¼š
â€¢ Leaderï¼šå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œå‘Followerå¤åˆ¶æ—¥å¿—
â€¢ Followerï¼šæ¥æ”¶Leaderçš„æ—¥å¿—å¤åˆ¶ï¼Œå‚ä¸é€‰ä¸¾
â€¢ Candidateï¼šLeaderé€‰ä¸¾æœŸé—´çš„ä¸´æ—¶è§’è‰²

æ•°æ®å¤åˆ¶æµç¨‹ï¼š
æ­¥éª¤1ï¼šå®¢æˆ·ç«¯å‘Leaderå‘é€å†™è¯·æ±‚
æ­¥éª¤2ï¼šLeaderå°†å˜æ›´å†™å…¥æœ¬åœ°æ—¥å¿—
æ­¥éª¤3ï¼šLeaderå‘æ‰€æœ‰Followerå¤åˆ¶æ—¥å¿—æ¡ç›®
æ­¥éª¤4ï¼šè¶…è¿‡åŠæ•°Followerç¡®è®¤æ¥æ”¶
æ­¥éª¤5ï¼šLeaderæäº¤å˜æ›´ï¼Œè¿”å›æˆåŠŸå“åº”
```

## 6.2 é›†ç¾¤è„‘è£‚é˜²æŠ¤



**ğŸ§  ä»€ä¹ˆæ˜¯è„‘è£‚**

è„‘è£‚å°±åƒä¸€ä¸ªå…¬å¸åŒæ—¶æœ‰ä¸¤ä¸ªCEOï¼Œéƒ½è®¤ä¸ºè‡ªå·±æ˜¯çœŸæ­£çš„é¢†å¯¼ï¼Œç»“æœå¯¼è‡´å‘½ä»¤å†²çªï¼Œæ•´ä¸ªç»„ç»‡æ··ä¹±ã€‚

**è„‘è£‚äº§ç”ŸåŸå› **ï¼š
```
ç½‘ç»œåˆ†åŒºåœºæ™¯ï¼š
etcd-1 â†â†’ etcd-2    |ç½‘ç»œæ–­å¼€|    etcd-3
       â†–            â†—
         etcdèŠ‚ç‚¹

åˆ†åŒºAï¼šetcd-1, etcd-2 (2ä¸ªèŠ‚ç‚¹)  
åˆ†åŒºBï¼šetcd-3 (1ä¸ªèŠ‚ç‚¹)

é”™è¯¯æƒ…å†µï¼šå¦‚æœä¸¤ä¸ªåˆ†åŒºéƒ½é€‰å‡ºLeader
æ­£ç¡®æƒ…å†µï¼šåªæœ‰åˆ†åŒºAèƒ½é€‰å‡ºLeader(è¶…è¿‡åŠæ•°)
```

**é˜²è„‘è£‚æœºåˆ¶**ï¼š
```
å¥‡æ•°èŠ‚ç‚¹éƒ¨ç½²ï¼š
â€¢ 3èŠ‚ç‚¹ï¼šå…è®¸1ä¸ªæ•…éšœï¼Œéœ€è¦2ä¸ªèŠ‚ç‚¹ç¡®è®¤
â€¢ 5èŠ‚ç‚¹ï¼šå…è®¸2ä¸ªæ•…éšœï¼Œéœ€è¦3ä¸ªèŠ‚ç‚¹ç¡®è®¤  
â€¢ 7èŠ‚ç‚¹ï¼šå…è®¸3ä¸ªæ•…éšœï¼Œéœ€è¦4ä¸ªèŠ‚ç‚¹ç¡®è®¤

è¿‡åŠæ•°åŸåˆ™ï¼š
â€¢ å†™æ“ä½œå¿…é¡»å¾—åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹ç¡®è®¤
â€¢ é€‰ä¸¾å¿…é¡»å¾—åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹æŠ•ç¥¨
â€¢ ç¡®ä¿ä»»ä½•æ—¶å€™æœ€å¤šåªæœ‰ä¸€ä¸ªLeader
```

## 6.3 æ•°æ®å¤‡ä»½ä¸æ¢å¤



**ğŸ’¾ etcdå¤‡ä»½ç­–ç•¥**

```bash
# åˆ›å»ºetcdå¤‡ä»½

ETCDCTL_API=3 etcdctl snapshot save backup.db \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key

# éªŒè¯å¤‡ä»½æ–‡ä»¶

ETCDCTL_API=3 etcdctl snapshot status backup.db --write-out=table

# æ¢å¤etcdé›†ç¾¤

ETCDCTL_API=3 etcdctl snapshot restore backup.db \
  --name etcd-1 \
  --initial-cluster etcd-1=https://192.168.1.10:2380 \
  --initial-cluster-token etcd-cluster-1 \
  --initial-advertise-peer-urls https://192.168.1.10:2380
```

**è‡ªåŠ¨å¤‡ä»½è„šæœ¬**ï¼š
```bash
#!/bin/bash

# etcd-backup.sh


BACKUP_DIR="/backup/etcd"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/etcd-backup-$DATE.db"

# åˆ›å»ºå¤‡ä»½ç›®å½•

mkdir -p $BACKUP_DIR

# æ‰§è¡Œå¤‡ä»½

ETCDCTL_API=3 etcdctl snapshot save $BACKUP_FILE \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½

find $BACKUP_DIR -name "etcd-backup-*.db" -mtime +7 -delete

echo "Backup completed: $BACKUP_FILE"
```

---

# 7. ğŸ›¡ï¸ åˆ†åŒºå®¹é”™å¤„ç†



## 7.1 ç½‘ç»œåˆ†åŒºåŸºæœ¬æ¦‚å¿µ



**ğŸŒ ä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†åŒº**

ç½‘ç»œåˆ†åŒºå°±åƒæ˜¯åŸå¸‚ä¹‹é—´çš„æ¡¥æ¢æ–­äº†ï¼Œä¸¤è¾¹çš„äººæš‚æ—¶æ— æ³•ç›´æ¥é€šä¿¡ï¼Œä½†å„è‡ªå†…éƒ¨è¿˜èƒ½æ­£å¸¸äº¤æµã€‚

**åˆ†åŒºåœºæ™¯ç¤ºä¾‹**ï¼š
```
æ­£å¸¸ç½‘ç»œæ‹“æ‰‘ï¼š
Master1 â†â†’ Master2 â†â†’ Master3
   â†‘         â†‘         â†‘
   â†“         â†“         â†“  
Worker1   Worker2   Worker3

ç½‘ç»œåˆ†åŒºåï¼š
[åˆ†åŒºA]              [åˆ†åŒºB]
Master1 â†â†’ Master2   Master3
   â†‘         â†‘         â†‘
   â†“         â†“         â†“
Worker1   Worker2   Worker3

é—®é¢˜ï¼šä¸¤ä¸ªåˆ†åŒºæ— æ³•é€šä¿¡ï¼Œä½†å†…éƒ¨è¿æ¥æ­£å¸¸
```

## 7.2 etcdåˆ†åŒºå®¹é”™



**âš¡ Raftç®—æ³•çš„åˆ†åŒºå¤„ç†**

```
3èŠ‚ç‚¹é›†ç¾¤åˆ†åŒºåœºæ™¯ï¼š

åœºæ™¯1ï¼š1+2åˆ†åŒº
[etcd-1]    |åˆ†åŒº|    [etcd-2, etcd-3]
  1ä¸ªèŠ‚ç‚¹              2ä¸ªèŠ‚ç‚¹

ç»“æœï¼š
â€¢ etcd-1æ— æ³•é€‰å‡ºLeaderï¼ˆä¸è¶³åŠæ•°ï¼‰
â€¢ etcd-2,etcd-3å¯ä»¥é€‰å‡ºLeaderï¼ˆè¶…è¿‡åŠæ•°ï¼‰
â€¢ åªæœ‰åˆ†åŒºBå¯ä»¥æä¾›å†™æœåŠ¡

åœºæ™¯2ï¼š2+1åˆ†åŒº  
[etcd-1, etcd-2]    |åˆ†åŒº|    [etcd-3]
    2ä¸ªèŠ‚ç‚¹                    1ä¸ªèŠ‚ç‚¹

ç»“æœï¼š
â€¢ etcd-1,etcd-2å¯ä»¥é€‰å‡ºLeaderï¼ˆè¶…è¿‡åŠæ•°ï¼‰
â€¢ etcd-3æ— æ³•é€‰å‡ºLeader
â€¢ åªæœ‰åˆ†åŒºAå¯ä»¥æä¾›å†™æœåŠ¡
```

**å®¹é”™èƒ½åŠ›åˆ†æ**ï¼š
| é›†ç¾¤å¤§å° | **å…è®¸æ•…éšœèŠ‚ç‚¹æ•°** | **æœ€å°å·¥ä½œèŠ‚ç‚¹æ•°** | **æ¨èåœºæ™¯** |
|---------|------------------|------------------|-------------|
| 3èŠ‚ç‚¹ | `1ä¸ª` | `2ä¸ª` | `å°è§„æ¨¡æµ‹è¯•ç¯å¢ƒ` |
| 5èŠ‚ç‚¹ | `2ä¸ª` | `3ä¸ª` | `ä¸­ç­‰è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ` |
| 7èŠ‚ç‚¹ | `3ä¸ª` | `4ä¸ª` | `å¤§è§„æ¨¡å…³é”®ä¸šåŠ¡` |

## 7.3 åº”ç”¨å±‚åˆ†åŒºå®¹é”™



**ğŸ”§ Podåäº²å’Œæ€§é…ç½®**

ç¡®ä¿å…³é”®åº”ç”¨åˆ†å¸ƒåœ¨ä¸åŒå¯ç”¨åŒºï¼š

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: critical-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: critical-app
  template:
    metadata:
      labels:
        app: critical-app
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app: critical-app
            topologyKey: kubernetes.io/zone    # ä¸åŒå¯ç”¨åŒº
      containers:
      - name: app
        image: nginx
```

**ğŸ¢ èŠ‚ç‚¹æ ‡ç­¾å’Œè°ƒåº¦**

```bash
# ä¸ºèŠ‚ç‚¹æ·»åŠ å¯ç”¨åŒºæ ‡ç­¾

kubectl label node k8s-worker-01 kubernetes.io/zone=zone-a
kubectl label node k8s-worker-02 kubernetes.io/zone=zone-b
kubectl label node k8s-worker-03 kubernetes.io/zone=zone-c

# æŸ¥çœ‹èŠ‚ç‚¹æ ‡ç­¾

kubectl get nodes --show-labels
```

## 7.4 åˆ†åŒºæ¢å¤ç­–ç•¥



**ğŸ”„ ç½‘ç»œåˆ†åŒºæ¢å¤åçš„å¤„ç†**

```bash
# 1. æ£€æŸ¥é›†ç¾¤çŠ¶æ€

kubectl get nodes
kubectl get pods --all-namespaces

# 2. éªŒè¯etcdé›†ç¾¤å¥åº·

kubectl exec -it etcd-k8s-master-01 -n kube-system -- etcdctl \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key \
  endpoint health

# 3. é‡æ–°å¯åŠ¨æ•…éšœèŠ‚ç‚¹ä¸Šçš„kubelet

systemctl restart kubelet

# 4. æ£€æŸ¥Podé‡æ–°åˆ†å¸ƒ

kubectl get pods -o wide --watch
```

---

# 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ é«˜å¯ç”¨æœ¬è´¨ï¼šé€šè¿‡å†—ä½™é¿å…å•ç‚¹æ•…éšœï¼Œç¡®ä¿æœåŠ¡è¿ç»­æ€§
ğŸ”¸ Masteré«˜å¯ç”¨ï¼šå¤šä¸ªMasterèŠ‚ç‚¹ï¼ŒLeaderé€‰ä¸¾é˜²å†²çª
ğŸ”¸ etcdé«˜å¯ç”¨ï¼šå¥‡æ•°èŠ‚ç‚¹é›†ç¾¤ï¼ŒRaftç®—æ³•ä¿è¯ä¸€è‡´æ€§
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šç»Ÿä¸€å…¥å£ï¼Œå¥åº·æ£€æŸ¥ï¼Œæ•…éšœè‡ªåŠ¨åˆ‡æ¢
ğŸ”¸ æ•…éšœè½¬ç§»ï¼šç»„ä»¶çº§ã€èŠ‚ç‚¹çº§ã€é›†ç¾¤çº§çš„è‡ªåŠ¨æ¢å¤
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šå¼ºä¸€è‡´æ€§ä¿è¯ï¼Œé˜²æ­¢è„‘è£‚
ğŸ”¸ åˆ†åŒºå®¹é”™ï¼šç½‘ç»œåˆ†åŒºä¸‹çš„æœåŠ¡å¯ç”¨æ€§ä¿éšœ
```

## 8.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ é«˜å¯ç”¨è®¾è®¡æ€è·¯**
```
å†—ä½™åŸåˆ™ï¼š
â€¢ å…³é”®ç»„ä»¶å¤šå‰¯æœ¬éƒ¨ç½²
â€¢ é¿å…ä»»ä½•å•ç‚¹æ•…éšœ
â€¢ è·¨å¯ç”¨åŒºåˆ†å¸ƒéƒ¨ç½²

ä¸€è‡´æ€§åŸåˆ™ï¼š
â€¢ ä½¿ç”¨å…±è¯†ç®—æ³•ä¿è¯æ•°æ®ä¸€è‡´
â€¢ è¿‡åŠæ•°ç¡®è®¤æœºåˆ¶
â€¢ å¼ºä¸€è‡´æ€§ä¼˜äºæœ€ç»ˆä¸€è‡´æ€§

è‡ªåŠ¨åŒ–åŸåˆ™ï¼š
â€¢ è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ¢å¤
â€¢ æ— éœ€äººå·¥å¹²é¢„çš„åˆ‡æ¢
â€¢ å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦
```

**ğŸ”¹ å®¹é”™èƒ½åŠ›è¯„ä¼°**
```
RTO (Recovery Time Objective)ï¼š
â€¢ æ•…éšœåå¤šé•¿æ—¶é—´æ¢å¤æœåŠ¡
â€¢ ç›®æ ‡ï¼š< 5åˆ†é’Ÿ

RPO (Recovery Point Objective)ï¼š  
â€¢ èƒ½å®¹å¿çš„æœ€å¤§æ•°æ®ä¸¢å¤±æ—¶é—´
â€¢ ç›®æ ‡ï¼š0 (å¼ºä¸€è‡´æ€§ï¼Œæ— æ•°æ®ä¸¢å¤±)

å¯ç”¨æ€§è®¡ç®—ï¼š
â€¢ 99.99% = å¹´åœæœº52.6åˆ†é’Ÿ
â€¢ å½±å“å› ç´ ï¼šç»„ä»¶æ•…éšœæ¦‚ç‡ã€æ¢å¤æ—¶é—´
```

## 8.3 ç”Ÿäº§å®è·µæŒ‡å—



**ğŸ¯ éƒ¨ç½²å»ºè®®**
```
èŠ‚ç‚¹è§„åˆ’ï¼š
âœ… è‡³å°‘3ä¸ªMasterèŠ‚ç‚¹
âœ… è·¨å¯ç”¨åŒºéƒ¨ç½²
âœ… ç‹¬ç«‹çš„etcdé›†ç¾¤ï¼ˆå¤§è§„æ¨¡ç¯å¢ƒï¼‰
âœ… è´Ÿè½½å‡è¡¡å™¨é«˜å¯ç”¨

ç›‘æ§å‘Šè­¦ï¼š
âœ… etcdé›†ç¾¤å¥åº·çŠ¶æ€
âœ… Leaderé€‰ä¸¾çŠ¶æ€ç›‘æ§  
âœ… ç½‘ç»œåˆ†åŒºæ£€æµ‹
âœ… è‡ªåŠ¨å¤‡ä»½éªŒè¯
```

**âš ï¸ å¸¸è§é”™è¯¯**
```
âŒ éƒ¨ç½²å¶æ•°ä¸ªMasterèŠ‚ç‚¹
âŒ æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€å¯ç”¨åŒº
âŒ å¿½ç•¥ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–
âŒ ç¼ºå°‘å®šæœŸå¤‡ä»½éªŒè¯
âŒ æ²¡æœ‰ç¾éš¾æ¢å¤æ¼”ç»ƒ
```

## 8.4 è¿ç»´æœ€ä½³å®è·µ



**ğŸ”§ æ—¥å¸¸ç»´æŠ¤**
```
å®šæœŸæ£€æŸ¥ï¼š
â€¢ æ¯æ—¥ï¼šé›†ç¾¤å¥åº·çŠ¶æ€æ£€æŸ¥
â€¢ æ¯å‘¨ï¼šå¤‡ä»½æ–‡ä»¶éªŒè¯æ¢å¤
â€¢ æ¯æœˆï¼šæ•…éšœè½¬ç§»æ¼”ç»ƒ
â€¢ æ¯å­£åº¦ï¼šç¾éš¾æ¢å¤æµ‹è¯•

æ€§èƒ½ä¼˜åŒ–ï¼š
â€¢ etcdå­˜å‚¨å‹ç¼©å’Œç¢ç‰‡æ•´ç†
â€¢ ç½‘ç»œå»¶è¿Ÿç›‘æ§å’Œä¼˜åŒ–
â€¢ è¯ä¹¦è¿‡æœŸæ—¶é—´ç®¡ç†
â€¢ æ—¥å¿—è½®è½¬å’Œæ¸…ç†
```

**ğŸš¨ åº”æ€¥å“åº”**
```
æ•…éšœå¤„ç†æµç¨‹ï¼š
æ­¥éª¤1ï¼šå¿«é€Ÿè¯„ä¼°å½±å“èŒƒå›´
æ­¥éª¤2ï¼šå¯åŠ¨åº”æ€¥æ¢å¤ç¨‹åº
æ­¥éª¤3ï¼šè®°å½•æ•…éšœç°è±¡å’Œå¤„ç†è¿‡ç¨‹
æ­¥éª¤4ï¼šæ•…éšœåå¤ç›˜å’Œæ”¹è¿›

å¸¸ç”¨åº”æ€¥å‘½ä»¤ï¼š
â€¢ kubectl get nodes
â€¢ kubectl get pods --all-namespaces
â€¢ kubectl describe node <node-name>
â€¢ journalctl -u kubelet -f
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†**
- é«˜å¯ç”¨ = å†—ä½™éƒ¨ç½² + è‡ªåŠ¨åˆ‡æ¢ + æ•°æ®ä¿æŠ¤
- etcdæ˜¯é›†ç¾¤"å¤§è„‘"ï¼Œå¿…é¡»ç”¨å¥‡æ•°ä¸ªèŠ‚ç‚¹éƒ¨ç½²
- Leaderé€‰ä¸¾ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªç»„ä»¶å·¥ä½œ
- ç½‘ç»œåˆ†åŒºæ—¶ï¼Œè¶…è¿‡åŠæ•°çš„åˆ†åŒºæ‰èƒ½æ­£å¸¸å·¥ä½œ
- å¤‡ä»½å’Œæ¼”ç»ƒæ˜¯é«˜å¯ç”¨çš„é‡è¦ä¿éšœ