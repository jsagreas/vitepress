---
title: 5ã€å®‰å…¨åŸºçº¿é…ç½®
---
## ğŸ“š ç›®å½•


1. [Kuberneteså®‰å…¨æ¦‚è¿°](#1-kuberneteså®‰å…¨æ¦‚è¿°)
2. [é›†ç¾¤å®‰å…¨åŠ å›º](#2-é›†ç¾¤å®‰å…¨åŠ å›º)
3. [ç½‘ç»œå®‰å…¨ç­–ç•¥](#3-ç½‘ç»œå®‰å…¨ç­–ç•¥)
4. [é•œåƒå®‰å…¨æ‰«æ](#4-é•œåƒå®‰å…¨æ‰«æ)
5. [è¿è¡Œæ—¶å®‰å…¨](#5-è¿è¡Œæ—¶å®‰å…¨)
6. [å®¡è®¡æ—¥å¿—é…ç½®](#6-å®¡è®¡æ—¥å¿—é…ç½®)
7. [åˆè§„æ€§æ£€æŸ¥](#7-åˆè§„æ€§æ£€æŸ¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ Kuberneteså®‰å…¨æ¦‚è¿°



### 1.1 ä¸ºä»€ä¹ˆå®‰å…¨è¿™ä¹ˆé‡è¦



æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„Kubernetesé›†ç¾¤å°±åƒä¸€åº§å¤§å‹è´­ç‰©ä¸­å¿ƒï¼Œé‡Œé¢æœ‰å„ç§å•†åº—ï¼ˆåº”ç”¨ï¼‰ï¼Œæœ‰é¡¾å®¢è¿›å‡ºï¼ˆæµé‡ï¼‰ï¼Œæœ‰ä¿å®‰å·¡é€»ï¼ˆç›‘æ§ï¼‰ã€‚å¦‚æœæ²¡æœ‰å®Œå–„çš„å®‰å…¨æªæ–½ï¼Œå°±åƒä¸€ä¸ªæ²¡æœ‰é—¨ç¦ã€ç›‘æ§å’Œä¿å®‰çš„è´­ç‰©ä¸­å¿ƒï¼Œéšæ—¶å¯èƒ½å‡ºç°é—®é¢˜ã€‚

**ğŸ¯ Kuberneteså®‰å…¨çš„æ ¸å¿ƒç†å¿µ**
```
æ·±åº¦é˜²å¾¡ï¼ˆDefense in Depthï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾¹ç•Œå®‰å…¨ï¼ˆç½‘ç»œé˜²ç«å¢™ï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é›†ç¾¤å®‰å…¨ï¼ˆRBACæƒé™æ§åˆ¶ï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èŠ‚ç‚¹å®‰å…¨ï¼ˆä¸»æœºåŠ å›ºï¼‰            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®¹å™¨å®‰å…¨ï¼ˆé•œåƒæ‰«æï¼‰            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åº”ç”¨å®‰å…¨ï¼ˆä»£ç å®‰å…¨ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯ä¸€å±‚éƒ½æ˜¯ä¸€é“é˜²çº¿ï¼Œå³ä½¿ä¸€å±‚è¢«æ”»ç ´ï¼Œ
å…¶ä»–å±‚ä¾ç„¶èƒ½æä¾›ä¿æŠ¤
```

### 1.2 Kuberneteså®‰å…¨å¨èƒæ¨¡å‹



**å¸¸è§çš„å®‰å…¨å¨èƒï¼š**
- **â‘ ** **å¤–éƒ¨æ”»å‡»**ï¼šé»‘å®¢è¯•å›¾ä»å¤–éƒ¨å…¥ä¾µé›†ç¾¤
- **â‘¡** **å†…éƒ¨å¨èƒ**ï¼šæ¶æ„ç”¨æˆ·æˆ–è¢«å…¥ä¾µçš„å†…éƒ¨è´¦å·
- **â‘¢** **é…ç½®é”™è¯¯**ï¼šé”™è¯¯çš„æƒé™è®¾ç½®å¯¼è‡´çš„å®‰å…¨æ¼æ´
- **â‘£** **ä¾›åº”é“¾æ”»å‡»**ï¼šæ¶æ„çš„å®¹å™¨é•œåƒæˆ–ç»„ä»¶

> ğŸ’¡ **æ–°æ‰‹ç†è§£**ï¼šå°±åƒå®¶åº­å®‰å…¨ï¼Œä½ éœ€è¦é˜²èŒƒé™Œç”Ÿäººï¼ˆå¤–éƒ¨æ”»å‡»ï¼‰ã€ä¸å¯ä¿¡çš„è®¿å®¢ï¼ˆå†…éƒ¨å¨èƒï¼‰ã€å¿˜è®°é”é—¨ï¼ˆé…ç½®é”™è¯¯ï¼‰ã€ä»¥åŠä¹°åˆ°æœ‰é—®é¢˜çš„å®¶ç”µï¼ˆä¾›åº”é“¾æ”»å‡»ï¼‰

### 1.3 å®‰å…¨åŸºçº¿çš„é‡è¦æ€§



**ä»€ä¹ˆæ˜¯å®‰å…¨åŸºçº¿ï¼Ÿ**
å®‰å…¨åŸºçº¿å°±åƒå»ºæˆ¿å­çš„åŸºç¡€æ ‡å‡†ï¼Œè§„å®šäº†æœ€ä½çš„å®‰å…¨è¦æ±‚ã€‚ä¸è¾¾åˆ°è¿™ä¸ªæ ‡å‡†ï¼Œæˆ¿å­å°±ä¸å®‰å…¨ã€‚

**ğŸ—ï¸ å®‰å…¨åŸºçº¿åŒ…å«çš„å†…å®¹**
```
åŸºç¡€è®¾æ–½å®‰å…¨ â†’ ç½‘ç»œéš”ç¦»ã€èŠ‚ç‚¹åŠ å›º
è®¿é—®æ§åˆ¶     â†’ èº«ä»½è®¤è¯ã€æƒé™ç®¡ç†  
æ•°æ®ä¿æŠ¤     â†’ åŠ å¯†å­˜å‚¨ã€ä¼ è¾“åŠ å¯†
è¿è¡Œæ—¶é˜²æŠ¤   â†’ å®¹å™¨å®‰å…¨ã€è¿›ç¨‹ç›‘æ§
å®¡è®¡åˆè§„     â†’ æ—¥å¿—è®°å½•ã€åˆè§„æ£€æŸ¥
```

---

## 2. ğŸ” é›†ç¾¤å®‰å…¨åŠ å›º



### 2.1 API Serverå®‰å…¨é…ç½®



API Serveræ˜¯Kubernetesçš„"å¤§è„‘"ï¼Œæ‰€æœ‰æ“ä½œéƒ½è¦ç»è¿‡å®ƒã€‚ä¿æŠ¤API Serverå°±åƒä¿æŠ¤é“¶è¡Œçš„é‡‘åº“å¤§é—¨ã€‚

**ğŸ”‘ æ ¸å¿ƒå®‰å…¨é…ç½®**

**å¯ç”¨HTTPSå’Œè¯ä¹¦è®¤è¯**
```yaml
# API Serveré…ç½®ç¤ºä¾‹

apiVersion: v1
kind: Pod
metadata:
  name: kube-apiserver
spec:
  containers:
  - name: kube-apiserver
    command:
    - kube-apiserver
#    # ğŸ”¸ å¼ºåˆ¶ä½¿ç”¨HTTPS
    - --secure-port=6443
    - --insecure-port=0  # ç¦ç”¨HTTPç«¯å£
#    # ğŸ”¸ è¯ä¹¦é…ç½®
    - --tls-cert-file=/etc/ssl/certs/server.crt
    - --tls-private-key-file=/etc/ssl/certs/server.key
    - --client-ca-file=/etc/ssl/certs/ca.crt
```

**ç¦ç”¨åŒ¿åè®¿é—®**
```yaml
# ç¦ç”¨åŒ¿åç”¨æˆ·è®¿é—®

- --anonymous-auth=false
# å¯ç”¨å®¡è®¡æ—¥å¿—

- --audit-log-path=/var/log/audit.log
- --audit-policy-file=/etc/kubernetes/audit-policy.yaml
```

> âš ï¸ **é‡è¦æé†’**ï¼šå°±åƒé“¶è¡Œä¸å…è®¸æ²¡æœ‰èº«ä»½è¯çš„äººè¿›å…¥ï¼ŒKubernetesä¹Ÿä¸åº”è¯¥å…è®¸åŒ¿åç”¨æˆ·è®¿é—®

### 2.2 ETCDå®‰å…¨é…ç½®



ETCDå­˜å‚¨äº†é›†ç¾¤çš„æ‰€æœ‰æ•°æ®ï¼Œç›¸å½“äºKubernetesçš„"æ•°æ®åº“"ã€‚å¦‚æœè¢«æ”»ç ´ï¼Œæ•´ä¸ªé›†ç¾¤çš„ç§˜å¯†éƒ½ä¼šæ³„éœ²ã€‚

**ğŸ›¡ï¸ ETCDå®‰å…¨æœ€ä½³å®è·µ**
```yaml
# ETCDå®‰å…¨é…ç½®

- --cert-file=/etc/ssl/etcd/server.crt
- --key-file=/etc/ssl/etcd/server.key
- --trusted-ca-file=/etc/ssl/etcd/ca.crt
# ğŸ”¸ å¯ç”¨æ•°æ®åŠ å¯†

- --encryption-provider-config=/etc/kubernetes/encryption.yaml
```

**æ•°æ®åŠ å¯†é…ç½®**
```yaml
# encryption.yaml - æ•°æ®é™æ€åŠ å¯†é…ç½®

apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
- resources:
  - secrets      # åŠ å¯†Secretæ•°æ®
  - configmaps   # åŠ å¯†ConfigMapæ•°æ®
  providers:
  - aescbc:      # ä½¿ç”¨AESåŠ å¯†
      keys:
      - name: key1
        secret: <base64-encoded-secret>
  - identity: {} # å¤‡ç”¨é€‰é¡¹
```

### 2.3 èŠ‚ç‚¹å®‰å…¨åŠ å›º



æ¯ä¸ªWorkerèŠ‚ç‚¹å°±åƒå…¬å¸çš„ä¸€ä¸ªåŠå…¬å®¤ï¼Œéœ€è¦ç¡®ä¿åŠå…¬å®¤æœ¬èº«æ˜¯å®‰å…¨çš„ã€‚

**ğŸ  èŠ‚ç‚¹å®‰å…¨æ£€æŸ¥æ¸…å•**

**â‘  ç³»ç»ŸåŠ å›º**
- âœ… å®šæœŸæ›´æ–°æ“ä½œç³»ç»Ÿè¡¥ä¸
- âœ… ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡å’Œç«¯å£
- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
- âœ… å¯ç”¨SELinux/AppArmor

**â‘¡ Kubeletå®‰å…¨é…ç½®**
```yaml
# kubeleté…ç½®æ–‡ä»¶

apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
# ğŸ”¸ ç¦ç”¨åŒ¿åè®¿é—®

authentication:
  anonymous:
    enabled: false
  webhook:
    enabled: true
# ğŸ”¸ å¯ç”¨æˆæƒ

authorization:
  mode: Webhook
# ğŸ”¸ åªè¯»ç«¯å£ç¦ç”¨

readOnlyPort: 0
```

---

## 3. ğŸŒ ç½‘ç»œå®‰å…¨ç­–ç•¥



### 3.1 ç½‘ç»œç­–ç•¥åŸºç¡€æ¦‚å¿µ



æƒ³è±¡Kubernetesé›†ç¾¤æ˜¯ä¸€ä¸ªå¤§åŠå…¬æ¥¼ï¼ŒNetwork Policyå°±åƒæ˜¯é—¨ç¦å¡ç³»ç»Ÿï¼Œå†³å®šè°å¯ä»¥è®¿é—®å“ªäº›åŒºåŸŸã€‚

**ğŸ¢ ç½‘ç»œéš”ç¦»ç¤ºæ„å›¾**
```
åŠå…¬æ¥¼ç½‘ç»œéš”ç¦»ç¤ºä¾‹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯åŒºåŸŸ (Frontend)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚Web1 â”‚ â”‚Web2 â”‚ â”‚Web3 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ âœ… å…è®¸è®¿é—®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯åŒºåŸŸ (Backend)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚API1 â”‚ â”‚API2 â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ âœ… å…è®¸è®¿é—®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“åŒºåŸŸ (Database)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚DB1  â”‚ â”‚DB2  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åˆ›å»ºç½‘ç»œå®‰å…¨ç­–ç•¥



**ğŸ¯ åŸºç¡€ç½‘ç»œç­–ç•¥ç¤ºä¾‹**

**æ‹’ç»æ‰€æœ‰æµé‡ï¼ˆé»˜è®¤æ‹’ç»ï¼‰**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-all
  namespace: production
spec:
  podSelector: {}  # é€‰æ‹©æ‰€æœ‰Pod
  policyTypes:
  - Ingress  # å…¥ç«™æµé‡
  - Egress   # å‡ºç«™æµé‡
#  # æ³¨æ„ï¼šæ²¡æœ‰å®šä¹‰rulesï¼Œæ„å‘³ç€æ‹’ç»æ‰€æœ‰æµé‡
```

**å…è®¸ç‰¹å®šåº”ç”¨é—´é€šä¿¡**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend-to-backend
  namespace: production
spec:
#  # ğŸ¯ ç­–ç•¥åº”ç”¨åˆ°å“ªäº›Podï¼ˆç›®æ ‡ï¼‰
  podSelector:
    matchLabels:
      app: backend
  policyTypes:
  - Ingress
  ingress:
  - from:
#    # ğŸ”¸ åªå…è®¸æ¥è‡ªfrontendçš„è¯·æ±‚
    - podSelector:
        matchLabels:
          app: frontend
    ports:
    - protocol: TCP
      port: 8080  # åªå…è®¸8080ç«¯å£
```

> ğŸ’¡ **é€šä¿—è§£é‡Š**ï¼šè¿™å°±åƒè®¾ç½®"åªæœ‰å‰å°å‘˜å·¥å¯ä»¥è®¿é—®åå°åŠå…¬å®¤çš„8080æˆ¿é—´"

### 3.3 ç½‘ç»œç­–ç•¥è¿›é˜¶é…ç½®



**æŒ‰å‘½åç©ºé—´éš”ç¦»**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: namespace-isolation
  namespace: production
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
#    # ğŸ”¸ åªå…è®¸åŒå‘½åç©ºé—´çš„Podé€šä¿¡
    - namespaceSelector:
        matchLabels:
          name: production
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: production
#  # ğŸ”¸ å…è®¸DNSæŸ¥è¯¢
  - to: []
    ports:
    - protocol: UDP
      port: 53
```

**ğŸŒŸ ç½‘ç»œç­–ç•¥æœ€ä½³å®è·µ**
```
â‘ é»˜è®¤æ‹’ç»    â†’ å…ˆåˆ›å»ºæ‹’ç»æ‰€æœ‰æµé‡çš„ç­–ç•¥
â‘¡æœ€å°æƒé™    â†’ åªå¼€æ”¾å¿…è¦çš„ç«¯å£å’Œåè®®  
â‘¢åˆ†å±‚é˜²æŠ¤    â†’ ç»“åˆå‘½åç©ºé—´å’Œæ ‡ç­¾é€‰æ‹©å™¨
â‘£å®šæœŸå®¡æŸ¥    â†’ å®šæœŸæ£€æŸ¥å’Œæ¸…ç†ä¸éœ€è¦çš„ç­–ç•¥
â‘¤ç›‘æ§å‘Šè­¦    â†’ ç›‘æ§è¢«æ‹’ç»çš„ç½‘ç»œè¿æ¥
```

---

## 4. ğŸ” é•œåƒå®‰å…¨æ‰«æ



### 4.1 ä¸ºä»€ä¹ˆè¦æ‰«æé•œåƒ



å®¹å™¨é•œåƒå°±åƒè½¯ä»¶çš„"DNA"ï¼Œé‡Œé¢åŒ…å«äº†åº”ç”¨ç¨‹åºå’Œæ‰€æœ‰ä¾èµ–ã€‚å¦‚æœé•œåƒæœ‰å®‰å…¨æ¼æ´ï¼Œå°±åƒDNAæœ‰ç¼ºé™·ï¼Œä¼šå½±å“æ•´ä¸ªåº”ç”¨çš„å®‰å…¨ã€‚

**ğŸ§¬ é•œåƒå®‰å…¨å¨èƒåˆ†æ**
```
é•œåƒå®‰å…¨å¨èƒå±‚æ¬¡ï¼š

åº”ç”¨å±‚å¨èƒï¼š
â”œâ”€â”€ æ¶æ„ä»£ç æ³¨å…¥
â”œâ”€â”€ åº”ç”¨ç¨‹åºæ¼æ´  
â””â”€â”€ é…ç½®æ–‡ä»¶æ³„éœ²

ä¾èµ–åº“å¨èƒï¼š
â”œâ”€â”€ è¿‡æœŸçš„ä¾èµ–åŒ…
â”œâ”€â”€ å·²çŸ¥CVEæ¼æ´
â””â”€â”€ æœªæˆæƒçš„åº“

åŸºç¡€é•œåƒå¨èƒï¼š
â”œâ”€â”€ æ“ä½œç³»ç»Ÿæ¼æ´
â”œâ”€â”€ é¢„è£…è½¯ä»¶æ¼æ´
â””â”€â”€ æƒé™é…ç½®é—®é¢˜
```

### 4.2 é•œåƒæ‰«æå·¥å…·å¯¹æ¯”



| å·¥å…·åç§° | **ä¼˜åŠ¿** | **é€‚ç”¨åœºæ™¯** | **æˆæœ¬** |
|---------|----------|-------------|----------|
| ğŸ”¸ **Trivy** | `å…è´¹å¼€æºï¼Œæ‰«æå…¨é¢` | `ä¸­å°å›¢é˜Ÿï¼ŒCI/CDé›†æˆ` | `å…è´¹` |
| ğŸ”¸ **Clair** | `è½»é‡çº§ï¼ŒAPIä¸°å¯Œ` | `è‡ªåŠ¨åŒ–é›†æˆï¼Œå¤§è§„æ¨¡æ‰«æ` | `å…è´¹` |
| ğŸ”¸ **Anchore** | `ä¼ä¸šçº§åŠŸèƒ½ï¼Œç­–ç•¥ç®¡ç†` | `å¤§å‹ä¼ä¸šï¼Œåˆè§„è¦æ±‚é«˜` | `å•†ä¸šç‰ˆä»˜è´¹` |
| ğŸ”¸ **Snyk** | `å¼€å‘å‹å¥½ï¼Œä¿®å¤å»ºè®®` | `å¼€å‘å›¢é˜Ÿï¼Œå¿«é€Ÿä¿®å¤` | `å…è´¹ç‰ˆ+ä»˜è´¹ç‰ˆ` |

### 4.3 ä½¿ç”¨Trivyè¿›è¡Œé•œåƒæ‰«æ



**ğŸ“¦ å®‰è£…å’ŒåŸºç¡€ä½¿ç”¨**
```bash
# å®‰è£…Trivy

curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin

# æ‰«æé•œåƒ

trivy image nginx:latest
```

**é›†æˆåˆ°CI/CDæµæ°´çº¿**
```yaml
# GitLab CIé…ç½®ç¤ºä¾‹

stages:
  - build
  - security-scan
  - deploy

security-scan:
  stage: security-scan
  image: aquasec/trivy:latest
  script:
#    # ğŸ”¸ æ‰«ææ„å»ºçš„é•œåƒ
    - trivy image --exit-code 1 --severity HIGH,CRITICAL $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
#    # ğŸ”¸ ç”ŸæˆæŠ¥å‘Š
    - trivy image --format json --output scan-report.json $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
  artifacts:
    reports:
#      # å°†æ‰«ææŠ¥å‘Šä½œä¸ºåˆ¶å“ä¿å­˜
      junit: scan-report.json
  only:
    - main
    - develop
```

### 4.4 å‡†å…¥æ§åˆ¶å™¨é›†æˆ



ä½¿ç”¨OPA Gatekeeperé˜»æ­¢ä¸å®‰å…¨çš„é•œåƒéƒ¨ç½²ï¼š

```yaml
apiVersion: templates.gatekeeper.sh/v1beta1
kind: ConstraintTemplate
metadata:
  name: allowedregistries
spec:
  crd:
    spec:
      properties:
        registries:
          type: array
          items:
            type: string
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package allowedregistries
        
        violation[{"msg": msg}] {
#          # ğŸ”¸ æ£€æŸ¥é•œåƒæ¥æº
          container := input.review.object.spec.containers[_]
          not starts_with(container.image, input.parameters.registries[_])
          msg := sprintf("é•œåƒ %v æ¥è‡ªä¸å—ä¿¡ä»»çš„ä»“åº“", [container.image])
        }
---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: AllowedRegistries
metadata:
  name: must-use-trusted-registry
spec:
  match:
    kinds:
      - apiGroups: ["apps"]
        kinds: ["Deployment"]
  parameters:
#    # ğŸ”¸ åªå…è®¸æ¥è‡ªè¿™äº›ä»“åº“çš„é•œåƒ
    registries:
      - "registry.company.com/"
      - "docker.io/library/"
```

---

## 5. âš¡ è¿è¡Œæ—¶å®‰å…¨



### 5.1 è¿è¡Œæ—¶å®‰å…¨æ¦‚è¿°



è¿è¡Œæ—¶å®‰å…¨å°±åƒæ˜¯24å°æ—¶çš„ä¿å®‰ï¼Œåœ¨å®¹å™¨è¿è¡ŒæœŸé—´æŒç»­ç›‘æ§å’Œé˜²æŠ¤ã€‚å³ä½¿æœ‰æ¶æ„ä»£ç ç»•è¿‡äº†ä¹‹å‰çš„æ£€æŸ¥ï¼Œè¿è¡Œæ—¶å®‰å…¨ä¹Ÿèƒ½åŠæ—¶å‘ç°å’Œé˜»æ­¢ã€‚

**ğŸš¨ è¿è¡Œæ—¶å®‰å…¨ç›‘æ§å†…å®¹**
```
è¿›ç¨‹è¡Œä¸ºç›‘æ§ï¼š
â”œâ”€â”€ å¼‚å¸¸è¿›ç¨‹å¯åŠ¨
â”œâ”€â”€ ææƒæ“ä½œå°è¯•  
â”œâ”€â”€ ç³»ç»Ÿè°ƒç”¨å¼‚å¸¸
â””â”€â”€ ç½‘ç»œè¿æ¥å¼‚å¸¸

æ–‡ä»¶ç³»ç»Ÿç›‘æ§ï¼š
â”œâ”€â”€ æ•æ„Ÿæ–‡ä»¶è®¿é—®
â”œâ”€â”€ é…ç½®æ–‡ä»¶ä¿®æ”¹
â”œâ”€â”€ æ¶æ„æ–‡ä»¶å†™å…¥  
â””â”€â”€ æƒé™å˜æ›´æ“ä½œ

ç½‘ç»œè¡Œä¸ºç›‘æ§ï¼š
â”œâ”€â”€ å¼‚å¸¸ç½‘ç»œè¿æ¥
â”œâ”€â”€ æ•°æ®æ³„éœ²æ£€æµ‹
â”œâ”€â”€ æ¶æ„åŸŸåè®¿é—®
â””â”€â”€ ç«¯å£æ‰«æè¡Œä¸º
```

### 5.2 Podå®‰å…¨æ ‡å‡†é…ç½®



Kubernetesæä¾›äº†Podå®‰å…¨æ ‡å‡†ï¼ˆPod Security Standardsï¼‰ï¼Œç›¸å½“äºç»™å®¹å™¨è®¾ç½®"è¡Œä¸ºè§„èŒƒ"ã€‚

**ğŸ›¡ï¸ ä¸‰ä¸ªå®‰å…¨çº§åˆ«å¯¹æ¯”**

| çº§åˆ« | **æè¿°** | **é€‚ç”¨åœºæ™¯** | **ä¸»è¦é™åˆ¶** |
|------|----------|-------------|-------------|
| **Privileged** | `å®Œå…¨æ— é™åˆ¶` | `ç³»ç»Ÿç»„ä»¶ï¼Œç‰¹æ®Šéœ€æ±‚` | `æ— é™åˆ¶` |
| **Baseline** | `åŸºæœ¬å®‰å…¨é˜²æŠ¤` | `ä¸€èˆ¬åº”ç”¨ï¼Œå¹³è¡¡å®‰å…¨å’ŒåŠŸèƒ½` | `ç¦æ­¢ç‰¹æƒå®¹å™¨ï¼Œé™åˆ¶ä¸»æœºè®¿é—®` |
| **Restricted** | `ä¸¥æ ¼å®‰å…¨é™åˆ¶` | `é«˜å®‰å…¨è¦æ±‚çš„åº”ç”¨` | `ä¸¥æ ¼çš„ç”¨æˆ·IDé™åˆ¶ï¼Œåªè¯»æ–‡ä»¶ç³»ç»Ÿ` |

**é…ç½®Podå®‰å…¨ç­–ç•¥**
```yaml
# å‘½åç©ºé—´çº§åˆ«çš„å®‰å…¨ç­–ç•¥

apiVersion: v1
kind: Namespace
metadata:
  name: secure-app
  labels:
#    # ğŸ”¸ è®¾ç½®å®‰å…¨çº§åˆ«ä¸ºrestricted
    pod-security.kubernetes.io/enforce: restricted
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/warn: restricted
```

**å®‰å…¨çš„Podé…ç½®ç¤ºä¾‹**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secure-pod
  namespace: secure-app
spec:
#  # ğŸ”¸ ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  containers:
  - name: app
    image: nginx:latest
    securityContext:
#      # ğŸ”¸ ç¦æ­¢ææƒ
      allowPrivilegeEscalation: false
#      # ğŸ”¸ åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ
      readOnlyRootFilesystem: true
#      # ğŸ”¸ ç§»é™¤æ‰€æœ‰èƒ½åŠ›
      capabilities:
        drop:
        - ALL
#    # ğŸ”¸ èµ„æºé™åˆ¶
    resources:
      limits:
        memory: "128Mi"
        cpu: "100m"
      requests:
        memory: "64Mi"
        cpu: "50m"
#    # ğŸ”¸ åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿéœ€è¦ä¸´æ—¶ç›®å½•
    volumeMounts:
    - name: tmp-volume
      mountPath: /tmp
  volumes:
  - name: tmp-volume
    emptyDir: {}
```

### 5.3 Falcoè¿è¡Œæ—¶ç›‘æ§



Falcoæ˜¯ä¸€ä¸ªå¼€æºçš„è¿è¡Œæ—¶å®‰å…¨ç›‘æ§å·¥å…·ï¼Œå°±åƒç»™Kubernetesè£…äº†ä¸€ä¸ª"æ™ºèƒ½ç›‘æ§æ‘„åƒå¤´"ã€‚

**å®‰è£…Falco**
```yaml
# ä½¿ç”¨Helmå®‰è£…Falco

apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: falco
  namespace: argocd
spec:
  source:
    repoURL: https://falcosecurity.github.io/charts
    chart: falco
    targetRevision: 2.4.0
    helm:
      values: |
        falco:
#          # ğŸ”¸ å¯ç”¨æ—¥å¿—è¾“å‡º
          json_output: true
#          # ğŸ”¸ è‡ªå®šä¹‰è§„åˆ™
          rules_file:
            - /etc/falco/falco_rules.yaml
            - /etc/falco/custom_rules.yaml
```

**è‡ªå®šä¹‰Falcoè§„åˆ™ç¤ºä¾‹**
```yaml
# custom_rules.yaml

- rule: æ£€æµ‹å®¹å™¨å†…å¼‚å¸¸è¿›ç¨‹
  desc: ç›‘æ§å®¹å™¨å†…å¯åŠ¨çš„å¼‚å¸¸è¿›ç¨‹
  condition: >
    spawned_process and container and
    (proc.name in (nc, ncat, netcat, nmap, dig, nslookup, tcpdump))
  output: >
    å¼‚å¸¸è¿›ç¨‹å¯åŠ¨ (user=%user.name command=%proc.cmdline 
    container=%container.name image=%container.image.repository)
  priority: WARNING
  tags: [process, container]

- rule: æ£€æµ‹ç‰¹æƒå®¹å™¨
  desc: æ£€æµ‹ç‰¹æƒæ¨¡å¼è¿è¡Œçš„å®¹å™¨
  condition: >
    container_started and container and
    ka.response_successful and
    ka.verb in (create, update) and
    ka.target.resource=pods and
    ka.request_object.spec.containers[*].securityContext.privileged=true
  output: >
    ç‰¹æƒå®¹å™¨å¯åŠ¨ (user=%ka.user.name pod=%ka.target.name 
    ns=%ka.target.namespace image=%ka.request_object.spec.containers[*].image)
  priority: CRITICAL
  tags: [security, privileged]
```

---

## 6. ğŸ“‹ å®¡è®¡æ—¥å¿—é…ç½®



### 6.1 å®¡è®¡æ—¥å¿—çš„é‡è¦æ€§



å®¡è®¡æ—¥å¿—å°±åƒé“¶è¡Œçš„ç›‘æ§å½•åƒï¼Œè®°å½•äº†æ‰€æœ‰åœ¨Kubernetesé›†ç¾¤ä¸­å‘ç”Ÿçš„æ“ä½œã€‚å½“å‡ºç°å®‰å…¨é—®é¢˜æ—¶ï¼Œå®¡è®¡æ—¥å¿—æ˜¯è¿½è¸ªé—®é¢˜å’Œåˆ†ææ”»å‡»è·¯å¾„çš„é‡è¦ä¾æ®ã€‚

**ğŸ¥ å®¡è®¡æ—¥å¿—è®°å½•çš„å†…å®¹**
```
ç”¨æˆ·æ“ä½œè®°å½•ï¼š
â”œâ”€â”€ è°(who)ï¼šç”¨æˆ·èº«ä»½ä¿¡æ¯
â”œâ”€â”€ ä½•æ—¶(when)ï¼šæ“ä½œæ—¶é—´æˆ³
â”œâ”€â”€ åšä»€ä¹ˆ(what)ï¼šå…·ä½“çš„æ“ä½œç±»å‹
â”œâ”€â”€ å¯¹ä»€ä¹ˆ(on what)ï¼šæ“ä½œçš„èµ„æºå¯¹è±¡
â””â”€â”€ ç»“æœå¦‚ä½•(result)ï¼šæ“ä½œæˆåŠŸè¿˜æ˜¯å¤±è´¥

å…¸å‹æ“ä½œç¤ºä¾‹ï¼š
ç”¨æˆ·aliceåœ¨2025-01-15 10:30:05
åˆ›å»ºäº†namespace/productionä¸‹çš„deployment/nginx
æ“ä½œç»“æœï¼šæˆåŠŸ
```

### 6.2 å®¡è®¡ç­–ç•¥é…ç½®



**ğŸ“ å®¡è®¡ç­–ç•¥é…ç½®æ–‡ä»¶**
```yaml
# audit-policy.yaml

apiVersion: audit.k8s.io/v1
kind: Policy
rules:
# ğŸ”¸ è®°å½•ç§˜é’¥å’Œæ•æ„Ÿæ•°æ®çš„æ‰€æœ‰æ“ä½œ

- level: Metadata
  namespaces: ["kube-system", "kube-public"]
  resources:
  - group: ""
    resources: ["secrets", "configmaps"]
  - group: "apps"
    resources: ["deployments", "daemonsets"]

# ğŸ”¸ è®°å½•æ‰€æœ‰è®¤è¯å¤±è´¥

- level: RequestResponse
  users: ["system:anonymous"]
  verb: ["get", "list", "watch"]

# ğŸ”¸ è®°å½•ç®¡ç†å‘˜çš„æ‰€æœ‰æ“ä½œ

- level: Request
  users: ["admin", "cluster-admin"]
  resources:
  - group: ""
    resources: ["*"]

# ğŸ”¸ å¿½ç•¥ç³»ç»Ÿç»„ä»¶çš„å¸¸è§„æ“ä½œ

- level: None
  users: ["system:kube-proxy"]
  verbs: ["watch"]
  resources:
  - group: ""
    resources: ["endpoints", "services"]
```

**API Serverå®¡è®¡é…ç½®**
```yaml
# kube-apiserveré…ç½®

spec:
  containers:
  - name: kube-apiserver
    command:
    - kube-apiserver
#    # ğŸ”¸ å¯ç”¨å®¡è®¡æ—¥å¿—
    - --audit-log-path=/var/log/audit.log
    - --audit-policy-file=/etc/kubernetes/audit-policy.yaml
    - --audit-log-maxage=30      # ä¿å­˜30å¤©
    - --audit-log-maxbackup=10   # æœ€å¤š10ä¸ªå¤‡ä»½æ–‡ä»¶
    - --audit-log-maxsize=100    # æ¯ä¸ªæ–‡ä»¶æœ€å¤§100MB
    volumeMounts:
    - name: audit-policy
      mountPath: /etc/kubernetes/audit-policy.yaml
      readOnly: true
    - name: audit-logs
      mountPath: /var/log
```

### 6.3 æ—¥å¿—åˆ†æå’Œå‘Šè­¦



**ä½¿ç”¨ELKåˆ†æå®¡è®¡æ—¥å¿—**
```yaml
# filebeaté…ç½®ï¼Œæ”¶é›†å®¡è®¡æ—¥å¿—

filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/audit.log
  json.keys_under_root: true
  json.add_error_key: true
  fields:
    logtype: k8s-audit
  fields_under_root: true

# ğŸ”¸ å‘é€åˆ°Elasticsearch

output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  index: "k8s-audit-%{+yyyy.MM.dd}"
```

**å¸¸ç”¨çš„å®¡è®¡æ—¥å¿—æŸ¥è¯¢**
```json
// KibanaæŸ¥è¯¢ç¤ºä¾‹

// æŸ¥è¯¢å¤±è´¥çš„è®¤è¯å°è¯•
{
  "query": {
    "bool": {
      "must": [
        {"match": {"verb": "create"}},
        {"match": {"objectRef.resource": "pods"}},
        {"range": {"stageTimestamp": {"gte": "now-1h"}}}
      ],
      "must_not": [
        {"match": {"responseStatus.code": 20*}}
      ]
    }
  }
}

// æŸ¥è¯¢ç‰¹æƒå®¹å™¨åˆ›å»º
{
  "query": {
    "bool": {
      "must": [
        {"match": {"requestObject.spec.containers.securityContext.privileged": true}},
        {"match": {"verb": "create"}}
      ]
    }
  }
}
```

---

## 7. âœ… åˆè§„æ€§æ£€æŸ¥



### 7.1 åˆè§„æ€§æ¡†æ¶æ¦‚è¿°



åˆè§„æ€§æ£€æŸ¥å°±åƒå¹´åº¦ä½“æ£€ï¼Œå®šæœŸæ£€æŸ¥é›†ç¾¤æ˜¯å¦ç¬¦åˆå®‰å…¨æ ‡å‡†ã€‚å¸¸è§çš„åˆè§„æ¡†æ¶åŒ…æ‹¬ï¼š

**ğŸ›ï¸ ä¸»è¦åˆè§„æ ‡å‡†**
```
CIS Kubernetes Benchmarkï¼š
â”œâ”€â”€ ç”±ç½‘ç»œå®‰å…¨ä¸­å¿ƒåˆ¶å®š
â”œâ”€â”€ åŒ…å«100+å®‰å…¨æ£€æŸ¥é¡¹
â”œâ”€â”€ åˆ†ä¸ºMasterèŠ‚ç‚¹å’ŒWorkerèŠ‚ç‚¹æ£€æŸ¥
â””â”€â”€ è¢«å¹¿æ³›é‡‡ç”¨çš„è¡Œä¸šæ ‡å‡†

NSA/CISAæŒ‡å—ï¼š
â”œâ”€â”€ ç¾å›½å›½å®¶å®‰å…¨å±€å‘å¸ƒ
â”œâ”€â”€ é‡ç‚¹å…³æ³¨é›¶ä¿¡ä»»æ¶æ„
â”œâ”€â”€ åŒ…å«Kuberneteså®‰å…¨æœ€ä½³å®è·µ
â””â”€â”€ é€‚åˆæ”¿åºœå’Œé«˜å®‰å…¨è¦æ±‚ç»„ç»‡

SOC 2 Type IIï¼š
â”œâ”€â”€ å…³æ³¨æ•°æ®å®‰å…¨å’Œéšç§
â”œâ”€â”€ è¦æ±‚æŒç»­ç›‘æ§
â”œâ”€â”€ é‡è§†è®¿é—®æ§åˆ¶å’Œå˜æ›´ç®¡ç†
â””â”€â”€ é€‚åˆSaaSæœåŠ¡æä¾›å•†
```

### 7.2 ä½¿ç”¨kube-benchè¿›è¡ŒCISæ£€æŸ¥



kube-benchæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Kuberneteså®‰å…¨æ£€æŸ¥å·¥å…·ï¼Œå°±åƒæœ‰ä¸€ä¸ªä¸“ä¸šçš„å®‰å…¨å®¡è®¡å¸ˆå¸®ä½ æ£€æŸ¥é›†ç¾¤é…ç½®ã€‚

**ğŸ“Š è¿è¡Œkube-bench**
```bash
# åœ¨MasterèŠ‚ç‚¹è¿è¡Œ

kubectl apply -f https://raw.githubusercontent.com/aquasecurity/kube-bench/main/job-master.yaml

# åœ¨WorkerèŠ‚ç‚¹è¿è¡Œ  

kubectl apply -f https://raw.githubusercontent.com/aquasecurity/kube-bench/main/job-node.yaml

# æŸ¥çœ‹æ£€æŸ¥ç»“æœ

kubectl logs job/kube-bench-master
```

**æ£€æŸ¥ç»“æœè§£è¯»**
```
[INFO] 1 Master Node Security Configuration
[INFO] 1.1 Master Node Configuration Files
[PASS] 1.1.1 Ensure that the API server pod specification file permissions are set to 644 or more restrictive
[FAIL] 1.1.2 Ensure that the API server pod specification file ownership is set to root:root
[WARN] 1.1.3 Ensure that the controller manager pod specification file permissions are set to 644 or more restrictive

== Summary ==
45 checks PASS     âœ… é€šè¿‡çš„æ£€æŸ¥é¡¹
3 checks FAIL      âŒ éœ€è¦ä¿®å¤çš„é—®é¢˜  
7 checks WARN      âš ï¸  éœ€è¦å…³æ³¨çš„è­¦å‘Š
2 checks INFO      ğŸ’¡ ä¿¡æ¯æ€§æç¤º
```

### 7.3 æŒç»­åˆè§„ç›‘æ§



**ä½¿ç”¨Polarisè¿›è¡ŒæŒç»­æ£€æŸ¥**
```yaml
# polarisé…ç½®

apiVersion: v1
kind: ConfigMap
metadata:
  name: polaris-config
  namespace: polaris
data:
  config.yaml: |
    checks:
#      # ğŸ”¸ å®‰å…¨æ£€æŸ¥
      runAsNonRoot: warning
      runAsUser: warning
      readOnlyRootFilesystem: warning
      privileged: danger
      allowPrivilegeEscalation: danger
      
#      # ğŸ”¸ èµ„æºæ£€æŸ¥  
      cpuRequestsMissing: warning
      memoryRequestsMissing: warning
      cpuLimitsMissing: warning
      memoryLimitsMissing: warning
      
#      # ğŸ”¸ é•œåƒæ£€æŸ¥
      tagNotSpecified: danger
      pullPolicyNotAlways: warning
      
#    # ğŸ”¸ è±å…é…ç½®
    exemptions:
    - namespace: kube-system
      rules:
      - privileged
      - runAsNonRoot
```

**è‡ªåŠ¨åŒ–åˆè§„æŠ¥å‘Š**
```yaml
# å®šæ—¶ä»»åŠ¡ç”Ÿæˆåˆè§„æŠ¥å‘Š

apiVersion: batch/v1
kind: CronJob
metadata:
  name: compliance-report
  namespace: security
spec:
  schedule: "0 2 * * *"  # æ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œ
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: compliance-check
            image: aquasec/kube-bench:latest
            command:
            - /bin/sh
            - -c
            - |
#              # è¿è¡Œå®‰å…¨æ£€æŸ¥
              kube-bench --json > /tmp/compliance-$(date +%Y%m%d).json
#              # ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨
              aws s3 cp /tmp/compliance-$(date +%Y%m%d).json s3://compliance-reports/
#              # å‘é€é‚®ä»¶é€šçŸ¥ï¼ˆå¦‚æœæœ‰é«˜å±é—®é¢˜ï¼‰
              if grep -q '"test_number": "1.1.2".*"result": "FAIL"' /tmp/compliance-$(date +%Y%m%d).json; then
                echo "å‘ç°é«˜å±å®‰å…¨é—®é¢˜ï¼Œè¯·åŠæ—¶å¤„ç†" | mail -s "K8så®‰å…¨å‘Šè­¦" admin@company.com
              fi
          restartPolicy: OnFailure
```

### 7.4 åˆè§„æ€§æœ€ä½³å®è·µ



**ğŸ¯ å»ºç«‹åˆè§„æµç¨‹**
```
â‘ åˆ¶å®šæ ‡å‡†     â†’ é€‰æ‹©é€‚åˆçš„åˆè§„æ¡†æ¶
â‘¡è‡ªåŠ¨åŒ–æ£€æŸ¥   â†’ é›†æˆåˆ°CI/CDæµæ°´çº¿
â‘¢å®šæœŸè¯„ä¼°     â†’ æ¯æœˆè¿›è¡Œå…¨é¢æ£€æŸ¥
â‘£é—®é¢˜è·Ÿè¸ª     â†’ å»ºç«‹é—®é¢˜ä¿®å¤è·Ÿè¸ªæœºåˆ¶
â‘¤æŒç»­æ”¹è¿›     â†’ æ ¹æ®æ£€æŸ¥ç»“æœä¼˜åŒ–é…ç½®
```

**åˆè§„æ£€æŸ¥æ¸…å•æ¨¡æ¿**
```markdown
# æ¯æœˆå®‰å…¨åˆè§„æ£€æŸ¥æ¸…å•



## ğŸ” è®¿é—®æ§åˆ¶ (æ¯æœˆ1å·æ£€æŸ¥)


- [ ] RBACæƒé™é…ç½®å®¡æŸ¥
- [ ] Service Accountæ¸…ç†  
- [ ] è¯ä¹¦æœ‰æ•ˆæœŸæ£€æŸ¥
- [ ] å¤šå› ç´ è®¤è¯çŠ¶æ€ç¡®è®¤

## ğŸŒ ç½‘ç»œå®‰å…¨ (æ¯æœˆ5å·æ£€æŸ¥)  


- [ ] Network Policyæœ‰æ•ˆæ€§éªŒè¯
- [ ] å…¥ç«™æµé‡è§„åˆ™å®¡æŸ¥
- [ ] DNSå®‰å…¨é…ç½®æ£€æŸ¥
- [ ] TLSè¯ä¹¦çŠ¶æ€ç¡®è®¤

## ğŸ” é•œåƒå®‰å…¨ (æ¯æœˆ10å·æ£€æŸ¥)


- [ ] æ¼æ´æ‰«ææŠ¥å‘Šå®¡æŸ¥
- [ ] é•œåƒæ¥æºå¯ä¿¡åº¦ç¡®è®¤
- [ ] è¿‡æœŸé•œåƒæ¸…ç†
- [ ] ç­¾åéªŒè¯çŠ¶æ€æ£€æŸ¥

## ğŸ“Š å®¡è®¡æ—¥å¿— (æ¯æœˆ15å·æ£€æŸ¥)


- [ ] å®¡è®¡æ—¥å¿—å®Œæ•´æ€§éªŒè¯
- [ ] å¼‚å¸¸æ´»åŠ¨åˆ†æ
- [ ] æ—¥å¿—ä¿ç•™ç­–ç•¥ç¡®è®¤
- [ ] å‘Šè­¦è§„åˆ™æœ‰æ•ˆæ€§æµ‹è¯•
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ æ·±åº¦é˜²å¾¡ï¼šå¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œæ¯ä¸€å±‚éƒ½æ˜¯é˜²çº¿
ğŸ”¸ æœ€å°æƒé™ï¼šåªç»™å¿…è¦çš„æƒé™ï¼Œé™ä½é£é™©æš´éœ²é¢
ğŸ”¸ é›¶ä¿¡ä»»ï¼šä¸ä¿¡ä»»ä»»ä½•äººå’Œä»»ä½•ç»„ä»¶ï¼Œå…¨é¢éªŒè¯
ğŸ”¸ æŒç»­ç›‘æ§ï¼šå®æ—¶ç›‘æ§å’Œå“åº”ï¼ŒåŠæ—¶å‘ç°å¨èƒ  
ğŸ”¸ åˆè§„ç®¡ç†ï¼šéµå¾ªè¡Œä¸šæ ‡å‡†ï¼Œå»ºç«‹è§„èŒƒæµç¨‹
```

### 8.2 å…³é”®å®‰å…¨é…ç½®è¦ç‚¹



**ğŸ”¹ é›†ç¾¤å®‰å…¨åŠ å›º**
```
API Serverå®‰å…¨ï¼š
â€¢ ç¦ç”¨åŒ¿åè®¿é—®ï¼Œå¯ç”¨HTTPS
â€¢ é…ç½®å¼ºè®¤è¯å’Œæˆæƒæœºåˆ¶
â€¢ å¯ç”¨å®¡è®¡æ—¥å¿—è®°å½•

ETCDå®‰å…¨ï¼š
â€¢ å¯ç”¨TLSåŠ å¯†é€šä¿¡
â€¢ é…ç½®æ•°æ®é™æ€åŠ å¯†
â€¢ é™åˆ¶è®¿é—®æƒé™

èŠ‚ç‚¹å®‰å…¨ï¼š
â€¢ å®šæœŸæ›´æ–°ç³»ç»Ÿè¡¥ä¸
â€¢ ç¦ç”¨ä¸å¿…è¦æœåŠ¡
â€¢ é…ç½®é˜²ç«å¢™è§„åˆ™
```

**ğŸ”¹ è¿è¡Œæ—¶å®‰å…¨é˜²æŠ¤**
```
Podå®‰å…¨æ ‡å‡†ï¼š
â€¢ ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ
â€¢ å¯ç”¨åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ
â€¢ è®¾ç½®èµ„æºé™åˆ¶

ç½‘ç»œå®‰å…¨ç­–ç•¥ï¼š
â€¢ é»˜è®¤æ‹’ç»æ‰€æœ‰æµé‡
â€¢ æŒ‰éœ€å¼€æ”¾å¿…è¦ç«¯å£
â€¢ å®ç°ç½‘ç»œå¾®åˆ†æ®µ

é•œåƒå®‰å…¨ï¼š
â€¢ ä½¿ç”¨å¯ä¿¡é•œåƒä»“åº“
â€¢ å®šæœŸæ‰«æå®‰å…¨æ¼æ´
â€¢ é›†æˆå‡†å…¥æ§åˆ¶å™¨
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼



**ğŸ“‹ å®‰å…¨å®æ–½è·¯çº¿å›¾**

**ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®‰å…¨ï¼ˆ1-2å‘¨ï¼‰**
- âœ… é…ç½®RBACåŸºç¡€æƒé™æ§åˆ¶
- âœ… å¯ç”¨Pod Security Standards
- âœ… éƒ¨ç½²åŸºç¡€ç½‘ç»œç­–ç•¥
- âœ… é…ç½®å®¡è®¡æ—¥å¿—

**ç¬¬äºŒé˜¶æ®µï¼šæ·±åº¦é˜²æŠ¤ï¼ˆ2-4å‘¨ï¼‰**  
- âœ… é›†æˆé•œåƒå®‰å…¨æ‰«æ
- âœ… éƒ¨ç½²è¿è¡Œæ—¶ç›‘æ§ï¼ˆFalcoï¼‰
- âœ… é…ç½®å‡†å…¥æ§åˆ¶å™¨
- âœ… å»ºç«‹å‘Šè­¦æœºåˆ¶

**ç¬¬ä¸‰é˜¶æ®µï¼šåˆè§„å®Œå–„ï¼ˆ4-8å‘¨ï¼‰**
- âœ… å®æ–½CISåŸºå‡†æ£€æŸ¥
- âœ… å»ºç«‹æŒç»­ç›‘æ§æµç¨‹
- âœ… å®Œå–„åº”æ€¥å“åº”æœºåˆ¶
- âœ… å®šæœŸå®‰å…¨è¯„ä¼°

### 8.4 å¸¸è§é—®é¢˜è§£å†³



**ğŸ”§ å®‰å…¨é…ç½®å¸¸è§é—®é¢˜**

**Q1ï¼šPodä¸€ç›´æ— æ³•å¯åŠ¨ï¼Œæç¤ºæƒé™é—®é¢˜ï¼Ÿ**
**A1ï¼š** æ£€æŸ¥Pod Security Standardsé…ç½®ï¼Œç¡®ä¿å®¹å™¨é…ç½®ç¬¦åˆå®‰å…¨è¦æ±‚ï¼š
```yaml
securityContext:
  runAsNonRoot: true    # å¿…é¡»é…ç½®
  runAsUser: 1000       # æŒ‡å®šç”¨æˆ·ID
  allowPrivilegeEscalation: false  # ç¦æ­¢ææƒ
```

**Q2ï¼šç½‘ç»œç­–ç•¥é…ç½®ååº”ç”¨æ— æ³•é€šä¿¡ï¼Ÿ**
**A2ï¼š** æ£€æŸ¥æ˜¯å¦é—æ¼äº†DNSè§£æè§„åˆ™ï¼š
```yaml
egress:
- to: []
  ports:
  - protocol: UDP
    port: 53    # å…è®¸DNSæŸ¥è¯¢
```

**Q3ï¼šå®¡è®¡æ—¥å¿—å ç”¨ç£ç›˜ç©ºé—´è¿‡å¤§ï¼Ÿ**
**A3ï¼š** ä¼˜åŒ–å®¡è®¡ç­–ç•¥ï¼Œè¿‡æ»¤ä¸é‡è¦çš„äº‹ä»¶ï¼š
```yaml
# å¿½ç•¥åªè¯»æ“ä½œ

- level: None
  verbs: ["get", "list", "watch"]
  resources:
  - group: ""
    resources: ["pods/log"]
```

### 8.5 å®‰å…¨æ–‡åŒ–å»ºè®¾



**ğŸ—ï¸ å»ºç«‹å®‰å…¨æ„è¯†**
```
å¼€å‘å›¢é˜Ÿï¼š
â€¢ å®‰å…¨ç¼–ç åŸ¹è®­
â€¢ å¨èƒå»ºæ¨¡å®è·µ  
â€¢ å®‰å…¨å·¥å…·ä½¿ç”¨

è¿ç»´å›¢é˜Ÿï¼š
â€¢ å®‰å…¨é…ç½®ç®¡ç†
â€¢ äº‹ä»¶å“åº”æµç¨‹
â€¢ ç›‘æ§å‘Šè­¦è®¾ç½®

ç®¡ç†å±‚ï¼š
â€¢ å®‰å…¨æ”¿ç­–åˆ¶å®š
â€¢ é¢„ç®—èµ„æºæŠ•å…¥
â€¢ é£é™©è¯„ä¼°å†³ç­–
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ·±åº¦é˜²å¾¡å±‚å±‚å®ˆï¼Œæœ€å°æƒé™æ˜¯æ ¹æœ¬
- é›¶ä¿¡ä»»éªŒè¯å…¨è¦†ç›–ï¼ŒæŒç»­ç›‘æ§ä¸æ”¾æ¾  
- é•œåƒæ‰«æé˜²æºå¤´ï¼Œè¿è¡Œç›‘æ§ä¿å®æ—¶
- å®¡è®¡åˆè§„å»ºåˆ¶åº¦ï¼Œå®‰å…¨æ–‡åŒ–äººäººæœ‰

> ğŸ’¡ **æ–°æ‰‹å»ºè®®**ï¼šå®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­æ”¹è¿›çš„è¿‡ç¨‹ï¼Œä¸è¦è¯•å›¾ä¸€æ¬¡æ€§åšåˆ°å®Œç¾ã€‚ä»åŸºç¡€åšèµ·ï¼Œé€æ­¥å®Œå–„ï¼Œå»ºç«‹å¥½çš„å®‰å…¨ä¹ æƒ¯æ¯”å¤æ‚çš„æŠ€æœ¯æ›´é‡è¦ï¼