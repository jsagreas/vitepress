---
title: 1ã€å¥åº·æ£€æŸ¥æ¢é’ˆ
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥æ¢é’ˆ](#1-ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥æ¢é’ˆ)
2. [ä¸‰ç§æ¢é’ˆç±»å‹è¯¦è§£](#2-ä¸‰ç§æ¢é’ˆç±»å‹è¯¦è§£)
3. [æ¢é’ˆæ£€æŸ¥æ–¹å¼](#3-æ¢é’ˆæ£€æŸ¥æ–¹å¼)
4. [æ¢é’ˆå‚æ•°é…ç½®è¯¦è§£](#4-æ¢é’ˆå‚æ•°é…ç½®è¯¦è§£)
5. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#5-å®æˆ˜é…ç½®æ¡ˆä¾‹)
6. [æ•…éšœå¤„ç†æœºåˆ¶](#6-æ•…éšœå¤„ç†æœºåˆ¶)
7. [æœ€ä½³å®è·µæŒ‡å—](#7-æœ€ä½³å®è·µæŒ‡å—)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥æ¢é’ˆ


### 1.1 å¥åº·æ£€æŸ¥çš„æœ¬è´¨


**ğŸ¯ ç®€å•ç†è§£**ï¼šå°±åƒåŒ»ç”Ÿç»™ç—…äººé‡ä½“æ¸©ã€æµ‹è¡€å‹ä¸€æ ·ï¼ŒK8séœ€è¦å®šæœŸæ£€æŸ¥å®¹å™¨æ˜¯å¦å¥åº·

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
åŒ»ç”Ÿæ£€æŸ¥ç—…äºº â†â†’ K8sæ£€æŸ¥å®¹å™¨
- é‡ä½“æ¸©     â†â†’ æ£€æŸ¥åº”ç”¨å“åº”
- æµ‹è¡€å‹     â†â†’ æ£€æŸ¥ç«¯å£è¿é€š
- é—®è¯Š       â†â†’ æ‰§è¡Œæ£€æŸ¥å‘½ä»¤
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å¥åº·æ£€æŸ¥**

åœ¨å®¹å™¨ä¸–ç•Œé‡Œï¼Œåº”ç”¨å¯èƒ½å‡ºç°å„ç§é—®é¢˜ï¼š
- åº”ç”¨**å¯åŠ¨äº†ä½†è¿˜æ²¡å‡†å¤‡å¥½**æ¥æ”¶è¯·æ±‚
- åº”ç”¨**è¿è¡Œè¿‡ç¨‹ä¸­å¡æ­»**äº†ä½†è¿›ç¨‹è¿˜åœ¨
- åº”ç”¨**å†…éƒ¨å‡ºé”™**ä½†å®¹å™¨çœ‹èµ·æ¥æ­£å¸¸

å¦‚æœæ²¡æœ‰å¥åº·æ£€æŸ¥ï¼ŒK8så°±åƒ"çå­"ä¸€æ ·ï¼Œä¸çŸ¥é“åº”ç”¨çš„çœŸå®çŠ¶æ€ã€‚

### 1.2 æ¢é’ˆçš„ä½œç”¨æœºåˆ¶


**ğŸ”§ å·¥ä½œåŸç†**

```
K8s MasterèŠ‚ç‚¹                     WorkerèŠ‚ç‚¹
     |                               |
     |---> å‘é€æ¢é’ˆæ£€æŸ¥æŒ‡ä»¤ ------->  kubelet
     |                               |
     |                           kubeletæ‰§è¡Œæ£€æŸ¥
     |                               |
     |<--- è¿”å›æ£€æŸ¥ç»“æœ <-----------  |
     |                               |
   æ ¹æ®ç»“æœ                      æ£€æŸ¥å®¹å™¨çŠ¶æ€
   å†³å®šåç»­åŠ¨ä½œ                   - HTTPè¯·æ±‚
                                - TCPè¿æ¥
                                - æ‰§è¡Œå‘½ä»¤
```

**âš¡ å…³é”®æ¦‚å¿µ**
- **æ¢é’ˆ (Probe)**ï¼šå°±æ˜¯æ£€æŸ¥å·¥å…·ï¼Œå®šæœŸæ‰§è¡Œæ£€æŸ¥ä»»åŠ¡
- **å¥åº· (Healthy)**ï¼šæ£€æŸ¥é€šè¿‡ï¼Œåº”ç”¨çŠ¶æ€æ­£å¸¸
- **ä¸å¥åº· (Unhealthy)**ï¼šæ£€æŸ¥å¤±è´¥ï¼Œéœ€è¦é‡‡å–è¡ŒåŠ¨

---

## 2. ğŸ¯ ä¸‰ç§æ¢é’ˆç±»å‹è¯¦è§£


### 2.1 å­˜æ´»æ¢é’ˆ (Liveness Probe)


**ğŸ”¸ æœ¬è´¨å«ä¹‰**ï¼šæ£€æŸ¥å®¹å™¨æ˜¯å¦"è¿˜æ´»ç€"

**ğŸ’­ é€šä¿—ç†è§£**ï¼š
å°±åƒæ£€æŸ¥ä¸€ä¸ªäººæ˜¯å¦è¿˜æœ‰å‘¼å¸å’Œå¿ƒè·³ã€‚å¦‚æœæ²¡æœ‰å¿ƒè·³äº†ï¼ˆåº”ç”¨å¡æ­»ï¼‰ï¼Œå°±éœ€è¦"æ€¥æ•‘"ï¼ˆé‡å¯å®¹å™¨ï¼‰ã€‚

**ğŸš¨ è§¦å‘åœºæ™¯**ï¼š
- åº”ç”¨è¿›ç¨‹å¡æ­»æ— å“åº”
- å†…å­˜æ³„æ¼å¯¼è‡´åº”ç”¨åƒµæ­»
- æ­»é”å¯¼è‡´åº”ç”¨åœæ­¢å·¥ä½œ
- åº”ç”¨å†…éƒ¨ä¸¥é‡é”™è¯¯

**âš¡ K8sçš„å¤„ç†åŠ¨ä½œ**ï¼š
```
å­˜æ´»æ¢é’ˆå¤±è´¥ â†’ K8sé‡å¯å®¹å™¨ â†’ å°è¯•æ¢å¤æœåŠ¡
```

**ğŸ“‹ å®é™…åº”ç”¨åœºæ™¯**ï¼š
- WebæœåŠ¡å™¨å¡æ­»ä¸å“åº”
- æ•°æ®åº“è¿æ¥æ± è€—å°½
- åå°ä»»åŠ¡å¤„ç†å¼‚å¸¸

### 2.2 å°±ç»ªæ¢é’ˆ (Readiness Probe)


**ğŸ”¸ æœ¬è´¨å«ä¹‰**ï¼šæ£€æŸ¥å®¹å™¨æ˜¯å¦"å‡†å¤‡å¥½å·¥ä½œ"

**ğŸ’­ é€šä¿—ç†è§£**ï¼š
å°±åƒæ£€æŸ¥ä¸€ä¸ªå‘˜å·¥æ˜¯å¦å‡†å¤‡å¥½ä¸Šç­ã€‚äººè™½ç„¶åˆ°äº†å…¬å¸ï¼ˆå®¹å™¨å¯åŠ¨ï¼‰ï¼Œä½†å¯èƒ½è¿˜åœ¨æ•´ç†æ¡Œå­ã€æ‰“å¼€ç”µè„‘ï¼ˆåº”ç”¨åˆå§‹åŒ–ï¼‰ï¼Œæš‚æ—¶ä¸èƒ½å¹²æ´»ã€‚

**ğŸ¯ è§¦å‘åœºæ™¯**ï¼š
- åº”ç”¨æ­£åœ¨å¯åŠ¨ä¸­ï¼Œè¿˜æ²¡åŠ è½½å®Œé…ç½®
- åº”ç”¨æ­£åœ¨è¿æ¥æ•°æ®åº“ï¼Œè¿˜æ²¡è¿ä¸Š
- åº”ç”¨æ­£åœ¨é¢„çƒ­ç¼“å­˜ï¼Œè¿˜æ²¡å‡†å¤‡å¥½
- åº”ç”¨ä¸´æ—¶è¿‡è½½ï¼Œæš‚æ—¶æ— æ³•å¤„ç†æ–°è¯·æ±‚

**âš¡ K8sçš„å¤„ç†åŠ¨ä½œ**ï¼š
```
å°±ç»ªæ¢é’ˆå¤±è´¥ â†’ ä»Serviceä¸­ç§»é™¤è¯¥Pod â†’ ä¸ä¼šæ”¶åˆ°æ–°è¯·æ±‚
å°±ç»ªæ¢é’ˆæˆåŠŸ â†’ åŠ å…¥Serviceè´Ÿè½½å‡è¡¡ â†’ å¼€å§‹å¤„ç†è¯·æ±‚
```

**ğŸ“‹ å®é™…åº”ç”¨åœºæ™¯**ï¼š
- Spring Bootåº”ç”¨å¯åŠ¨éœ€è¦æ—¶é—´
- æ•°æ®åº“åº”ç”¨éœ€è¦åŠ è½½æ•°æ®
- ç¼“å­˜æœåŠ¡éœ€è¦é¢„çƒ­

### 2.3 å¯åŠ¨æ¢é’ˆ (Startup Probe)


**ğŸ”¸ æœ¬è´¨å«ä¹‰**ï¼šæ£€æŸ¥å®¹å™¨æ˜¯å¦"å¯åŠ¨å®Œæˆ"

**ğŸ’­ é€šä¿—ç†è§£**ï¼š
å°±åƒæ£€æŸ¥ä¸€å°ç”µè„‘æ˜¯å¦å¼€æœºå®Œæˆã€‚ç”µè„‘æŒ‰ä¸‹ç”µæºé”®åï¼Œéœ€è¦åŠ è½½æ“ä½œç³»ç»Ÿã€å¯åŠ¨å„ç§ç¨‹åºï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½å¾ˆé•¿ï¼Œä¸èƒ½æ€¥ã€‚

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦å¯åŠ¨æ¢é’ˆ**ï¼š

æœ‰äº›åº”ç”¨å¯åŠ¨ç‰¹åˆ«æ…¢ï¼š
- å¤§å‹Javaåº”ç”¨å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿå¯åŠ¨
- æœºå™¨å­¦ä¹ æ¨¡å‹åŠ è½½éœ€è¦å¾ˆé•¿æ—¶é—´
- æ•°æ®åº“æ¢å¤éœ€è¦è¾ƒé•¿æ—¶é—´

å¦‚æœæ²¡æœ‰å¯åŠ¨æ¢é’ˆï¼Œå­˜æ´»æ¢é’ˆå¯èƒ½ä¼šè¿‡æ—©åˆ¤æ–­åº”ç”¨"æ­»äº†"è€Œé‡å¯å®ƒã€‚

**âš¡ K8sçš„å¤„ç†åŠ¨ä½œ**ï¼š
```
å¯åŠ¨æ¢é’ˆæˆåŠŸå‰ â†’ å­˜æ´»æ¢é’ˆå’Œå°±ç»ªæ¢é’ˆéƒ½ä¸å·¥ä½œ
å¯åŠ¨æ¢é’ˆæˆåŠŸå â†’ å­˜æ´»æ¢é’ˆå’Œå°±ç»ªæ¢é’ˆå¼€å§‹å·¥ä½œ
å¯åŠ¨æ¢é’ˆå¤±è´¥   â†’ K8sé‡å¯å®¹å™¨
```

### 2.4 ä¸‰ç§æ¢é’ˆçš„åä½œå…³ç³»


```
åº”ç”¨ç”Ÿå‘½å‘¨æœŸï¼šå¯åŠ¨ â†’ è¿è¡Œ â†’ ç»“æŸ

å¯åŠ¨é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Startup     â”‚ â†’ æ£€æŸ¥æ˜¯å¦å¯åŠ¨å®Œæˆ
â”‚ Probe       â”‚    æˆåŠŸåæ‰å¯ç”¨å…¶ä»–æ¢é’ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿è¡Œé˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Liveness    â”‚   â”‚ Readiness   â”‚
â”‚ Probe       â”‚   â”‚ Probe       â”‚
â”‚ æ£€æŸ¥æ˜¯å¦æ´»ç€  â”‚   â”‚ æ£€æŸ¥æ˜¯å¦å°±ç»ª  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**â­ é‡è¦ç†è§£**ï¼š
- **å¯åŠ¨æ¢é’ˆ**ï¼šä¸€æ¬¡æ€§çš„ï¼Œå¯åŠ¨å®Œæˆå°±ä¸å†æ‰§è¡Œ
- **å­˜æ´»æ¢é’ˆ**ï¼šæŒç»­æ‰§è¡Œï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½åœ¨æ£€æŸ¥
- **å°±ç»ªæ¢é’ˆ**ï¼šæŒç»­æ‰§è¡Œï¼Œéšæ—¶å¯èƒ½ä»å°±ç»ªå˜ä¸ºä¸å°±ç»ª

---

## 3. ğŸ”§ æ¢é’ˆæ£€æŸ¥æ–¹å¼


### 3.1 HTTP GET æ£€æŸ¥æ–¹å¼


**ğŸ”¸ å·¥ä½œåŸç†**ï¼šå‘å®¹å™¨å‘é€HTTPè¯·æ±‚ï¼Œæ ¹æ®å“åº”çŠ¶æ€åˆ¤æ–­å¥åº·çŠ¶æ€

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
å°±åƒæ‰“ç”µè¯ç»™æœ‹å‹ï¼Œå¦‚æœæœ‹å‹æ¥å¬äº†ï¼ˆè¿”å›200çŠ¶æ€ç ï¼‰ï¼Œè¯´æ˜æœ‹å‹åœ¨å®¶ä¸”çŠ¶æ€æ­£å¸¸ã€‚

**âœ… æˆåŠŸæ¡ä»¶**ï¼š
- HTTPçŠ¶æ€ç åœ¨ 200-399 èŒƒå›´å†…
- è¯·æ±‚åœ¨è¶…æ—¶æ—¶é—´å†…å¾—åˆ°å“åº”

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- Webåº”ç”¨ï¼ˆHTTP/HTTPSæœåŠ¡ï¼‰
- REST APIæœåŠ¡  
- å¾®æœåŠ¡åº”ç”¨

**ğŸ“‹ é…ç½®ç¤ºä¾‹**ï¼š
```yaml
livenessProbe:
  httpGet:
    path: /health        # å¥åº·æ£€æŸ¥è·¯å¾„
    port: 8080          # æ£€æŸ¥ç«¯å£
    scheme: HTTP        # åè®®ç±»å‹
    httpHeaders:        # å¯é€‰ï¼šè‡ªå®šä¹‰è¯·æ±‚å¤´
    - name: Custom-Header
      value: health-check
  initialDelaySeconds: 30
  periodSeconds: 10
```

**ğŸ” æ£€æŸ¥è¿‡ç¨‹è¯¦è§£**ï¼š

```
K8s kubelet                      åº”ç”¨å®¹å™¨
     |                              |
     |---> GET /health HTTP/1.1 --->|
     |     Host: pod-ip:8080        |
     |                              |
     |<--- HTTP/1.1 200 OK <--------|
     |     {"status": "healthy"}    |
     |                              |
   åˆ¤æ–­ä¸ºå¥åº·                     è¿”å›å¥åº·çŠ¶æ€
```

### 3.2 TCP Socket æ£€æŸ¥æ–¹å¼


**ğŸ”¸ å·¥ä½œåŸç†**ï¼šå°è¯•ä¸å®¹å™¨çš„æŒ‡å®šç«¯å£å»ºç«‹TCPè¿æ¥

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
å°±åƒæ•²æœ‹å‹å®¶çš„é—¨ï¼Œå¦‚æœé—¨èƒ½æ‰“å¼€ï¼ˆTCPè¿æ¥æˆåŠŸï¼‰ï¼Œè¯´æ˜æœ‹å‹åœ¨å®¶ã€‚

**âœ… æˆåŠŸæ¡ä»¶**ï¼š
- èƒ½å¤ŸæˆåŠŸå»ºç«‹TCPè¿æ¥
- è¿æ¥å»ºç«‹åœ¨è¶…æ—¶æ—¶é—´å†…

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- æ•°æ®åº“æœåŠ¡ï¼ˆMySQLã€PostgreSQLã€Redisï¼‰
- æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡
- ä¸æä¾›HTTPæ¥å£çš„åº”ç”¨

**ğŸ“‹ é…ç½®ç¤ºä¾‹**ï¼š
```yaml
readinessProbe:
  tcpSocket:
    port: 5432          # æ£€æŸ¥ç«¯å£ï¼ˆå¦‚PostgreSQLé»˜è®¤ç«¯å£ï¼‰
  initialDelaySeconds: 5
  periodSeconds: 10
```

**ğŸ” æ£€æŸ¥è¿‡ç¨‹è¯¦è§£**ï¼š

```
K8s kubelet                      æ•°æ®åº“å®¹å™¨
     |                              |
     |---> TCP SYN packet --------->| ç«¯å£5432
     |                              |
     |<--- TCP SYN-ACK packet <-----|
     |                              |
     |---> TCP ACK packet --------->|
     |                              |
   TCPè¿æ¥å»ºç«‹æˆåŠŸ                å»ºç«‹è¿æ¥æˆåŠŸ
   åˆ¤æ–­ä¸ºå°±ç»ª                      åº”ç”¨æ­£åœ¨ç›‘å¬
```

### 3.3 Exec å‘½ä»¤æ£€æŸ¥æ–¹å¼


**ğŸ”¸ å·¥ä½œåŸç†**ï¼šåœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œæ ¹æ®å‘½ä»¤é€€å‡ºç åˆ¤æ–­å¥åº·çŠ¶æ€

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
å°±åƒè®©æœ‹å‹åšä¸ªç®€å•ä»»åŠ¡ï¼ˆæ¯”å¦‚è¯´å¥è¯ï¼‰ï¼Œå¦‚æœèƒ½æ­£å¸¸å®Œæˆï¼Œè¯´æ˜æœ‹å‹çŠ¶æ€æ­£å¸¸ã€‚

**âœ… æˆåŠŸæ¡ä»¶**ï¼š
- å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼ˆé€€å‡ºç ä¸º0ï¼‰
- å‘½ä»¤åœ¨è¶…æ—¶æ—¶é—´å†…æ‰§è¡Œå®Œæˆ

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦è‡ªå®šä¹‰å¤æ‚æ£€æŸ¥é€»è¾‘
- æ£€æŸ¥æ–‡ä»¶ç³»ç»ŸçŠ¶æ€
- éªŒè¯åº”ç”¨å†…éƒ¨çŠ¶æ€
- æ•°æ®åº“è¿æ¥æ£€æŸ¥

**ğŸ“‹ é…ç½®ç¤ºä¾‹**ï¼š
```yaml
livenessProbe:
  exec:
    command:
    - /bin/sh
    - -c
    - "pg_isready -U postgres"  # PostgreSQLè¿æ¥æ£€æŸ¥
  initialDelaySeconds: 30
  periodSeconds: 10
```

**ğŸ” æ£€æŸ¥è¿‡ç¨‹è¯¦è§£**ï¼š

```
K8s kubelet                      åº”ç”¨å®¹å™¨
     |                              |
     |---> æ‰§è¡Œå‘½ä»¤è¯·æ±‚ ----------->|
     |     /bin/sh -c "command"     |
     |                              |
     |                           æ‰§è¡Œå‘½ä»¤
     |                              |
     |<--- è¿”å›é€€å‡ºç  <-------------|
     |     exit code: 0            |
     |                              |
   é€€å‡ºç ä¸º0åˆ¤æ–­ä¸ºå¥åº·             å‘½ä»¤æ‰§è¡ŒæˆåŠŸ
```

### 3.4 ä¸‰ç§æ£€æŸ¥æ–¹å¼å¯¹æ¯”


| æ£€æŸ¥æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **æ€§èƒ½å¼€é”€** |
|---------|------------|---------|---------|-------------|
| ğŸŒ **HTTP GET** | `Webåº”ç”¨ã€APIæœåŠ¡` | `ç®€å•ç›´è§‚ï¼Œæ ‡å‡†åŒ–` | `åªé€‚ç”¨HTTPæœåŠ¡` | `ä½` |
| ğŸ”Œ **TCP Socket** | `æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—` | `é€‚ç”¨æ€§å¹¿ï¼Œå¼€é”€å°` | `åªæ£€æŸ¥ç«¯å£è¿é€šæ€§` | `æä½` |
| ğŸ”§ **Execå‘½ä»¤** | `è‡ªå®šä¹‰å¤æ‚æ£€æŸ¥` | `çµæ´»æ€§å¼ºï¼ŒåŠŸèƒ½å…¨` | `å¼€é”€å¤§ï¼Œå¯èƒ½å½±å“å®¹å™¨` | `é«˜` |

**ğŸ’¡ é€‰æ‹©å»ºè®®**ï¼š
- **Webåº”ç”¨ä¼˜å…ˆé€‰æ‹©HTTP GET**ï¼šæœ€ç›´æ¥åæ˜ æœåŠ¡å¯ç”¨æ€§
- **æ•°æ®åº“ç­‰é€‰æ‹©TCP Socket**ï¼šè½»é‡çº§ä¸”æœ‰æ•ˆ
- **å¤æ‚é€»è¾‘é€‰æ‹©Exec**ï¼šéœ€è¦è°¨æ…ä½¿ç”¨ï¼Œé¿å…é¢‘ç¹æ‰§è¡Œ

---

## 4. âš™ï¸ æ¢é’ˆå‚æ•°é…ç½®è¯¦è§£


### 4.1 æ ¸å¿ƒæ—¶é—´å‚æ•°


**ğŸ”¸ å‚æ•°å«ä¹‰è§£é‡Š**

| å‚æ•°å | **ä¸­æ–‡å«ä¹‰** | **é€šä¿—ç†è§£** | **é»˜è®¤å€¼** | **å»ºè®®èŒƒå›´** |
|--------|------------|------------|-----------|-------------|
| `initialDelaySeconds` | `åˆå§‹å»¶è¿Ÿæ—¶é—´` | `åº”ç”¨å¯åŠ¨åç­‰å¤šä¹…å¼€å§‹æ£€æŸ¥` | `0ç§’` | `10-60ç§’` |
| `periodSeconds` | `æ£€æŸ¥é—´éš”æ—¶é—´` | `å¤šä¹…æ£€æŸ¥ä¸€æ¬¡` | `10ç§’` | `5-30ç§’` |
| `timeoutSeconds` | `æ£€æŸ¥è¶…æ—¶æ—¶é—´` | `æ¯æ¬¡æ£€æŸ¥æœ€å¤šç­‰å¤šä¹…` | `1ç§’` | `1-10ç§’` |
| `failureThreshold` | `å¤±è´¥é˜ˆå€¼` | `è¿ç»­å¤±è´¥å¤šå°‘æ¬¡æ‰ç®—çœŸæ­£å¤±è´¥` | `3æ¬¡` | `3-10æ¬¡` |
| `successThreshold` | `æˆåŠŸé˜ˆå€¼` | `è¿ç»­æˆåŠŸå¤šå°‘æ¬¡æ‰ç®—æ¢å¤æ­£å¸¸` | `1æ¬¡` | `1-3æ¬¡` |

### 4.2 å‚æ•°é…ç½®çš„å®é™…æ„ä¹‰


**â° initialDelaySecondsï¼ˆåˆå§‹å»¶è¿Ÿï¼‰**

**é€šä¿—ç†è§£**ï¼šå°±åƒç»™æ–°å‘˜å·¥ä¸€ä¸ªé€‚åº”æœŸï¼Œä¸è¦ä¸€ä¸Šç­å°±è€ƒæ ¸ã€‚

```
åº”ç”¨å¯åŠ¨æ—¶é—´çº¿ï¼š
å®¹å™¨å¯åŠ¨ â†’ åº”ç”¨åˆå§‹åŒ– â†’ [ç­‰å¾…åˆå§‹å»¶è¿Ÿ] â†’ å¼€å§‹å¥åº·æ£€æŸ¥

ä¸åŒåº”ç”¨çš„å¯åŠ¨æ—¶é—´ï¼š
- ç®€å•åº”ç”¨ï¼š5-10ç§’
- Spring Bootï¼š15-30ç§’  
- å¤§å‹åº”ç”¨ï¼š30-60ç§’
- æ•°æ®åº“ï¼š10-120ç§’
```

**ğŸ” periodSecondsï¼ˆæ£€æŸ¥é—´éš”ï¼‰**

**é€šä¿—ç†è§£**ï¼šå°±åƒä½“æ£€çš„é¢‘ç‡ï¼Œå¤ªé¢‘ç¹æµªè´¹èµ„æºï¼Œå¤ªç¨€ç–å¯èƒ½é”™è¿‡é—®é¢˜ã€‚

```
æ£€æŸ¥é¢‘ç‡æƒè¡¡ï¼š
é«˜é¢‘æ£€æŸ¥ï¼ˆ5ç§’ï¼‰  â†’ å¿«é€Ÿå‘ç°é—®é¢˜ + èµ„æºæ¶ˆè€—å¤§
ä¸­é¢‘æ£€æŸ¥ï¼ˆ10ç§’ï¼‰ â†’ å¹³è¡¡ç‚¹ + æ¨èé…ç½®  
ä½é¢‘æ£€æŸ¥ï¼ˆ30ç§’ï¼‰ â†’ èŠ‚çœèµ„æº + å‘ç°é—®é¢˜æ…¢
```

**â±ï¸ timeoutSecondsï¼ˆè¶…æ—¶æ—¶é—´ï¼‰**

**é€šä¿—ç†è§£**ï¼šç»™æ¯æ¬¡æ£€æŸ¥è®¾å®šä¸€ä¸ª"æœ€åæœŸé™"ã€‚

```
è¶…æ—¶è®¾ç½®è€ƒè™‘ï¼š
ç½‘ç»œå»¶è¿Ÿï¼šé€šå¸¸1-2ç§’
åº”ç”¨å“åº”ï¼šæ­£å¸¸0.1-1ç§’
æ•°æ®åº“æŸ¥è¯¢ï¼šå¯èƒ½éœ€è¦2-5ç§’
æ–‡ä»¶IOæ“ä½œï¼šå¯èƒ½éœ€è¦3-10ç§’
```

### 4.3 é˜ˆå€¼å‚æ•°çš„é‡è¦æ€§


**âŒ failureThresholdï¼ˆå¤±è´¥é˜ˆå€¼ï¼‰**

**é€šä¿—ç†è§£**ï¼šä¸èƒ½"ä¸€æ¬¡ä¸åŠæ ¼å°±å¼€é™¤"ï¼Œè¦ç»™å®¹é”™æœºä¼šã€‚

```
ä¸ºä»€ä¹ˆéœ€è¦å¤±è´¥é˜ˆå€¼ï¼š
- ç½‘ç»œå¶å°”æŠ–åŠ¨
- åº”ç”¨ä¸´æ—¶ç¹å¿™
- ç³»ç»Ÿèµ„æºç«äº‰
- æ¢é’ˆæœ¬èº«æ‰§è¡Œå¤±è´¥

å»ºè®®é…ç½®ï¼š
- å…³é”®æœåŠ¡ï¼š5-10æ¬¡ï¼ˆæ›´å®½å®¹ï¼‰
- ä¸€èˆ¬æœåŠ¡ï¼š3-5æ¬¡ï¼ˆå¹³è¡¡ï¼‰  
- æµ‹è¯•ç¯å¢ƒï¼š1-2æ¬¡ï¼ˆå¿«é€Ÿå‘ç°ï¼‰
```

**âœ… successThresholdï¼ˆæˆåŠŸé˜ˆå€¼ï¼‰**

**é€šä¿—ç†è§£**ï¼šç¡®è®¤"ç—…äºº"çœŸçš„åº·å¤äº†ï¼Œä¸æ˜¯å¶ç„¶å¥½è½¬ã€‚

```
ä¸åŒæ¢é’ˆçš„æˆåŠŸé˜ˆå€¼ï¼š
- Liveness Probeï¼šåªèƒ½æ˜¯1ï¼ˆå›ºå®šï¼‰
- Readiness Probeï¼šå¯ä»¥è®¾ç½®1-10
- Startup Probeï¼šåªèƒ½æ˜¯1ï¼ˆå›ºå®šï¼‰

ä¸ºä»€ä¹ˆReadinesså¯ä»¥>1ï¼š
é¿å…åº”ç”¨åœ¨å°±ç»ª/ä¸å°±ç»ªä¹‹é—´é¢‘ç¹åˆ‡æ¢
ç¡®ä¿åº”ç”¨çœŸæ­£ç¨³å®šåæ‰æ¥æ”¶æµé‡
```

### 4.4 å‚æ•°é…ç½®æœ€ä½³å®è·µ


**ğŸ¯ ä¸åŒç±»å‹åº”ç”¨çš„æ¨èé…ç½®**

```yaml
# å¿«é€Ÿå¯åŠ¨çš„Webåº”ç”¨
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 10    # å¯åŠ¨å¿«ï¼Œå»¶è¿ŸçŸ­
  periodSeconds: 10          # æ ‡å‡†æ£€æŸ¥é—´éš”
  timeoutSeconds: 3          # Webåº”ç”¨å“åº”å¿«
  failureThreshold: 3        # æ ‡å‡†å®¹é”™

# æ…¢å¯åŠ¨çš„æ•°æ®åº“åº”ç”¨  
livenessProbe:
  tcpSocket:
    port: 5432
  initialDelaySeconds: 60    # æ•°æ®åº“å¯åŠ¨æ…¢
  periodSeconds: 20          # é™ä½æ£€æŸ¥é¢‘ç‡
  timeoutSeconds: 5          # æ•°æ®åº“å¯èƒ½å“åº”æ…¢
  failureThreshold: 5        # æ›´å¤šå®¹é”™æœºä¼š
```

**âš ï¸ å¸¸è§é…ç½®é”™è¯¯**

| é”™è¯¯é…ç½® | **é—®é¢˜åæœ** | **æ­£ç¡®åšæ³•** |
|---------|------------|-------------|
| `initialDelaySecondså¤ªçŸ­` | `åº”ç”¨è¿˜æ²¡å¯åŠ¨å®Œå°±å¼€å§‹æ£€æŸ¥ï¼Œå¯¼è‡´è¯¯æ€` | `æ ¹æ®åº”ç”¨å®é™…å¯åŠ¨æ—¶é—´è®¾ç½®` |
| `timeoutSecondså¤ªçŸ­` | `ç½‘ç»œç¨æœ‰å»¶è¿Ÿå°±åˆ¤æ–­ä¸ºå¤±è´¥` | `ç•™è¶³å¤Ÿçš„å“åº”æ—¶é—´` |
| `failureThreshold=1` | `ç½‘ç»œæŠ–åŠ¨ä¸€æ¬¡å°±é‡å¯å®¹å™¨` | `è‡³å°‘è®¾ç½®ä¸º3` |
| `periodSecondså¤ªçŸ­` | `é¢‘ç¹æ£€æŸ¥æµªè´¹èµ„æº` | `ä¸€èˆ¬è®¾ç½®10-30ç§’` |

---

## 5. ğŸ’¼ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 5.1 Webåº”ç”¨å®Œæ•´é…ç½®


**ğŸ¯ åœºæ™¯**ï¼šä¸€ä¸ªSpring Boot Webåº”ç”¨ï¼Œå¯åŠ¨éœ€è¦20ç§’ï¼Œæä¾›REST API

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: spring-web-app
spec:
  containers:
  - name: web-app
    image: my-spring-app:1.0
    ports:
    - containerPort: 8080
    
    # å¯åŠ¨æ¢é’ˆï¼šç¡®ä¿åº”ç”¨å®Œå…¨å¯åŠ¨
    startupProbe:
      httpGet:
        path: /actuator/health
        port: 8080
      initialDelaySeconds: 10      # åº”ç”¨è‡³å°‘éœ€è¦10ç§’åŸºç¡€å¯åŠ¨
      periodSeconds: 5             # å¯åŠ¨é˜¶æ®µæ£€æŸ¥é¢‘ç¹ç‚¹
      timeoutSeconds: 3
      failureThreshold: 6          # 10+5*6=40ç§’å¯åŠ¨æ—¶é—´çª—å£
    
    # å­˜æ´»æ¢é’ˆï¼šæ£€æŸ¥åº”ç”¨æ˜¯å¦å¡æ­»
    livenessProbe:
      httpGet:
        path: /actuator/health
        port: 8080
      initialDelaySeconds: 0       # å¯åŠ¨æ¢é’ˆæˆåŠŸåç«‹å³ç”Ÿæ•ˆ
      periodSeconds: 15            # æ£€æŸ¥ä¸ç”¨å¤ªé¢‘ç¹
      timeoutSeconds: 5
      failureThreshold: 3
    
    # å°±ç»ªæ¢é’ˆï¼šæ£€æŸ¥æ˜¯å¦å‡†å¤‡æ¥æ”¶æµé‡
    readinessProbe:
      httpGet:
        path: /actuator/health/readiness
        port: 8080
      initialDelaySeconds: 0
      periodSeconds: 10
      timeoutSeconds: 3
      failureThreshold: 2          # å¿«é€Ÿç§»é™¤ä¸å°±ç»ªçš„Pod
      successThreshold: 1          # å°±ç»ªåç«‹å³åŠ å…¥æœåŠ¡
```

**ğŸ’¡ é…ç½®è¯´æ˜**ï¼š
- **å¯åŠ¨æ¢é’ˆ**ç»™äº†40ç§’å¯åŠ¨çª—å£ï¼Œç¡®ä¿Spring Bootæœ‰è¶³å¤Ÿæ—¶é—´å¯åŠ¨
- **å­˜æ´»æ¢é’ˆ**ä½¿ç”¨è¾ƒé•¿é—´éš”ï¼Œé¿å…è¿‡åº¦æ£€æŸ¥å½±å“æ€§èƒ½
- **å°±ç»ªæ¢é’ˆ**ä½¿ç”¨ä¸“é—¨çš„readinessç«¯ç‚¹ï¼Œæ›´ç²¾ç¡®

### 5.2 æ•°æ®åº“åº”ç”¨é…ç½®


**ğŸ¯ åœºæ™¯**ï¼šPostgreSQLæ•°æ®åº“ï¼Œéœ€è¦è¾ƒé•¿å¯åŠ¨æ—¶é—´å’Œæ•°æ®åŠ è½½

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: postgresql-db
spec:
  containers:
  - name: postgres
    image: postgres:13
    env:
    - name: POSTGRES_DB
      value: myapp
    - name: POSTGRES_USER
      value: admin
    - name: POSTGRES_PASSWORD
      valueFrom:
        secretKeyRef:
          name: db-secret
          key: password
    
    # å¯åŠ¨æ¢é’ˆï¼šæ•°æ®åº“å¯åŠ¨å¯èƒ½å¾ˆæ…¢
    startupProbe:
      exec:
        command:
        - /bin/sh
        - -c
        - "pg_isready -U admin -d myapp"
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 12         # ç»™2åˆ†é’Ÿå¯åŠ¨æ—¶é—´
    
    # å­˜æ´»æ¢é’ˆï¼šæ£€æŸ¥æ•°æ®åº“è¿›ç¨‹
    livenessProbe:
      tcpSocket:
        port: 5432               # ç®€å•çš„ç«¯å£æ£€æŸ¥
      initialDelaySeconds: 0
      periodSeconds: 30          # æ•°æ®åº“æ£€æŸ¥ä¸ç”¨å¤ªé¢‘ç¹
      timeoutSeconds: 10
      failureThreshold: 3
    
    # å°±ç»ªæ¢é’ˆï¼šç¡®ä¿æ•°æ®åº“çœŸæ­£å¯ä»¥æ¥å—è¿æ¥
    readinessProbe:
      exec:
        command:
        - /bin/sh
        - -c
        - "pg_isready -U admin -d myapp && psql -U admin -d myapp -c 'SELECT 1;'"
      initialDelaySeconds: 0
      periodSeconds: 15
      timeoutSeconds: 10
      failureThreshold: 3
```

**ğŸ’¡ é…ç½®è¯´æ˜**ï¼š
- **å¯åŠ¨æ¢é’ˆ**ä½¿ç”¨`pg_isready`æ£€æŸ¥æ•°æ®åº“åŸºç¡€å¯ç”¨æ€§
- **å­˜æ´»æ¢é’ˆ**ä½¿ç”¨TCPæ£€æŸ¥ï¼Œè½»é‡çº§ä¸”å¯é 
- **å°±ç»ªæ¢é’ˆ**ä¸ä»…æ£€æŸ¥è¿æ¥ï¼Œè¿˜æ‰§è¡Œç®€å•æŸ¥è¯¢ç¡®ä¿çœŸæ­£å¯ç”¨

### 5.3 å¾®æœåŠ¡åº”ç”¨é…ç½®


**ğŸ¯ åœºæ™¯**ï¼šä¸€ä¸ªéœ€è¦è¿æ¥å¤šä¸ªå¤–éƒ¨æœåŠ¡çš„å¾®æœåŠ¡

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: my-user-service:v1.2
        ports:
        - containerPort: 8080
        
        # ç¯å¢ƒå˜é‡é…ç½®
        env:
        - name: DATABASE_URL
          value: "postgresql://db:5432/users"
        - name: REDIS_URL  
          value: "redis://cache:6379"
        
        # å¯åŠ¨æ¢é’ˆ
        startupProbe:
          httpGet:
            path: /health/startup
            port: 8080
          initialDelaySeconds: 15
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 6
        
        # å­˜æ´»æ¢é’ˆï¼šæ£€æŸ¥åº”ç”¨æ ¸å¿ƒåŠŸèƒ½
        livenessProbe:
          httpGet:
            path: /health/live
            port: 8080
          initialDelaySeconds: 0
          periodSeconds: 20
          timeoutSeconds: 5
          failureThreshold: 3
        
        # å°±ç»ªæ¢é’ˆï¼šæ£€æŸ¥æ‰€æœ‰ä¾èµ–æœåŠ¡
        readinessProbe:
          httpGet:
            path: /health/ready
            port: 8080
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 2
          successThreshold: 1
```

**ğŸ’¡ é…ç½®è¯´æ˜**ï¼š
- ä½¿ç”¨ä¸åŒçš„å¥åº·æ£€æŸ¥ç«¯ç‚¹åˆ†åˆ«æ£€æŸ¥ä¸åŒçŠ¶æ€
- `/health/startup`ï¼šæ£€æŸ¥åŸºç¡€å¯åŠ¨å®Œæˆ
- `/health/live`ï¼šæ£€æŸ¥åº”ç”¨æ ¸å¿ƒåŠŸèƒ½
- `/health/ready`ï¼šæ£€æŸ¥æ‰€æœ‰å¤–éƒ¨ä¾èµ–å¯ç”¨æ€§

---

## 6. ğŸš¨ æ•…éšœå¤„ç†æœºåˆ¶


### 6.1 æ¢é’ˆå¤±è´¥åçš„å¤„ç†æµç¨‹


**ğŸ”¸ å­˜æ´»æ¢é’ˆå¤±è´¥å¤„ç†**

```
å­˜æ´»æ¢é’ˆæ£€æŸ¥å¤±è´¥
        â†“
è®°å½•å¤±è´¥æ¬¡æ•° +1
        â†“
å¤±è´¥æ¬¡æ•° < failureThresholdï¼Ÿ
    â†“ No              â†“ Yes
è§¦å‘é‡å¯å®¹å™¨      ç»§ç»­ç›‘æ§
    â†“
å®¹å™¨é‡å¯
    â†“
é‡æ–°å¼€å§‹æ¢é’ˆæ£€æŸ¥
```

**å®é™…å¤„ç†è¿‡ç¨‹**ï¼š
1. **kubelet**å‘ç°å­˜æ´»æ¢é’ˆè¿ç»­å¤±è´¥
2. æ ¹æ®Podçš„`restartPolicy`å†³å®šé‡å¯ç­–ç•¥
3. æ€æ­»å½“å‰å®¹å™¨ï¼Œå¯åŠ¨æ–°å®¹å™¨
4. æ–°å®¹å™¨ä»å¯åŠ¨æ¢é’ˆå¼€å§‹é‡æ–°æ£€æŸ¥

**ğŸ”¸ å°±ç»ªæ¢é’ˆå¤±è´¥å¤„ç†**

```
å°±ç»ªæ¢é’ˆæ£€æŸ¥å¤±è´¥
        â†“
ä»Service Endpointsä¸­ç§»é™¤Pod IP
        â†“
Podä¸å†æ¥æ”¶æ–°çš„æµé‡
        â†“
ç»§ç»­ç›‘æ§å°±ç»ªæ¢é’ˆ
        â†“
å°±ç»ªæ¢é’ˆæ¢å¤æˆåŠŸ
        â†“
é‡æ–°åŠ å…¥Service Endpoints
```

**å®é™…å¤„ç†è¿‡ç¨‹**ï¼š
1. **kubelet**å‘ç°å°±ç»ªæ¢é’ˆå¤±è´¥
2. é€šçŸ¥**kube-proxy**æ›´æ–°è´Ÿè½½å‡è¡¡è§„åˆ™
3. Podä»Serviceçš„åç«¯åˆ—è¡¨ä¸­è¢«ç§»é™¤
4. ç°æœ‰è¿æ¥å¯èƒ½ä¿æŒï¼Œä½†ä¸æ¥å—æ–°è¿æ¥

### 6.2 é‡å¯ç­–ç•¥è¯¦è§£


**ğŸ”§ restartPolicyé…ç½®**

| ç­–ç•¥å€¼ | **å«ä¹‰** | **é€‚ç”¨åœºæ™¯** | **è¡Œä¸ºæè¿°** |
|-------|---------|------------|-------------|
| `Always` | `æ€»æ˜¯é‡å¯` | `é•¿æœŸè¿è¡Œçš„æœåŠ¡` | `å®¹å™¨é€€å‡ºå°±é‡å¯ï¼Œé»˜è®¤ç­–ç•¥` |
| `OnFailure` | `å¤±è´¥æ—¶é‡å¯` | `æ‰¹å¤„ç†ä»»åŠ¡` | `åªæœ‰éæ­£å¸¸é€€å‡ºæ‰é‡å¯` |
| `Never` | `ä»ä¸é‡å¯` | `ä¸€æ¬¡æ€§ä»»åŠ¡` | `å®¹å™¨é€€å‡ºåä¸é‡å¯` |

**ğŸ’¡ é‡å¯å»¶è¿Ÿæœºåˆ¶**

K8sä½¿ç”¨æŒ‡æ•°é€€é¿ç­–ç•¥é¿å…é¢‘ç¹é‡å¯ï¼š

```
ç¬¬1æ¬¡é‡å¯ï¼šç«‹å³é‡å¯
ç¬¬2æ¬¡é‡å¯ï¼šå»¶è¿Ÿ10ç§’
ç¬¬3æ¬¡é‡å¯ï¼šå»¶è¿Ÿ20ç§’  
ç¬¬4æ¬¡é‡å¯ï¼šå»¶è¿Ÿ40ç§’
...
æœ€å¤§å»¶è¿Ÿï¼š300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰
```

### 6.3 å¸¸è§æ•…éšœåœºæ™¯å¤„ç†


**ğŸ”¥ åœºæ™¯1ï¼šåº”ç”¨å¯åŠ¨å¤±è´¥**

```
é—®é¢˜è¡¨ç°ï¼š
- å¯åŠ¨æ¢é’ˆæŒç»­å¤±è´¥
- å®¹å™¨ä¸æ–­é‡å¯
- PodçŠ¶æ€æ˜¾ç¤ºCrashLoopBackOff

æ’æŸ¥æ­¥éª¤ï¼š
1. kubectl logs pod-name              # æŸ¥çœ‹åº”ç”¨æ—¥å¿—
2. kubectl describe pod pod-name      # æŸ¥çœ‹Podäº‹ä»¶
3. kubectl get events                 # æŸ¥çœ‹é›†ç¾¤äº‹ä»¶

å¸¸è§åŸå› ï¼š
- é•œåƒé”™è¯¯æˆ–ç¼ºå°‘ä¾èµ–
- é…ç½®æ–‡ä»¶é”™è¯¯
- èµ„æºä¸è¶³ï¼ˆå†…å­˜ã€CPUï¼‰
- å¤–éƒ¨ä¾èµ–ä¸å¯ç”¨
```

**ğŸ”¥ åœºæ™¯2ï¼šåº”ç”¨è¿è¡Œä¸­å¡æ­»**

```
é—®é¢˜è¡¨ç°ï¼š
- å­˜æ´»æ¢é’ˆå¼€å§‹å¤±è´¥
- åº”ç”¨ä¸å“åº”è¯·æ±‚
- å®¹å™¨è¢«é‡å¯

å¤„ç†æœºåˆ¶ï¼š
å­˜æ´»æ¢é’ˆå¤±è´¥ â†’ å®¹å™¨é‡å¯ â†’ æœåŠ¡æ¢å¤

é¢„é˜²æªæ–½ï¼š
- è®¾ç½®åˆç†çš„èµ„æºé™åˆ¶
- ä¼˜åŒ–åº”ç”¨ä»£ç é¿å…æ­»é”
- ç›‘æ§åº”ç”¨æ€§èƒ½æŒ‡æ ‡
```

**ğŸ”¥ åœºæ™¯3ï¼šåº”ç”¨ä¸´æ—¶ä¸å¯ç”¨**

```
é—®é¢˜è¡¨ç°ï¼š
- å°±ç»ªæ¢é’ˆå¤±è´¥
- Podä»Serviceä¸­è¢«ç§»é™¤
- åº”ç”¨æš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚

å¤„ç†æœºåˆ¶ï¼š
å°±ç»ªæ¢é’ˆå¤±è´¥ â†’ ç§»é™¤æµé‡ â†’ ç­‰å¾…æ¢å¤ â†’ é‡æ–°åŠ å…¥

å¸¸è§åŸå› ï¼š
- åº”ç”¨ä¸´æ—¶è¿‡è½½
- å¤–éƒ¨ä¾èµ–æš‚æ—¶ä¸å¯ç”¨
- åº”ç”¨æ­£åœ¨æ‰§è¡Œç»´æŠ¤ä»»åŠ¡
```

### 6.4 æ•…éšœå¤„ç†æœ€ä½³å®è·µ


**ğŸ“‹ ç›‘æ§å‘Šè­¦è®¾ç½®**

```yaml
# ç¤ºä¾‹ï¼šPrometheuså‘Šè­¦è§„åˆ™
groups:
- name: k8s-probes
  rules:
  - alert: PodNotReady
    expr: kube_pod_status_ready{condition="false"} == 1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Pod {{ $labels.namespace }}/{{ $labels.pod }} not ready"
      
  - alert: PodCrashLooping  
    expr: rate(kube_pod_container_status_restarts_total[15m]) > 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "Pod {{ $labels.namespace }}/{{ $labels.pod }} crash looping"
```

**ğŸ”§ æ•…éšœæ¢å¤ç­–ç•¥**

1. **è‡ªåŠ¨æ¢å¤**ï¼šä¾é æ¢é’ˆæœºåˆ¶è‡ªåŠ¨å¤„ç†
2. **æ¸è¿›å¼éƒ¨ç½²**ï¼šä½¿ç”¨æ»šåŠ¨æ›´æ–°å‡å°‘å½±å“
3. **ç†”æ–­æœºåˆ¶**ï¼šåœ¨åº”ç”¨å±‚å®ç°ç†”æ–­ä¿æŠ¤
4. **ç›‘æ§å‘Šè­¦**ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜

---

## 7. ğŸ¯ æœ€ä½³å®è·µæŒ‡å—


### 7.1 æ¢é’ˆè®¾è®¡åŸåˆ™


**ğŸ”¸ è½»é‡çº§åŸåˆ™**

**ä¸ºä»€ä¹ˆè¦è½»é‡çº§**ï¼š
- æ¢é’ˆä¼šé¢‘ç¹æ‰§è¡Œï¼Œä¸èƒ½å½±å“åº”ç”¨æ€§èƒ½
- é¿å…æ¢é’ˆæœ¬èº«æˆä¸ºç³»ç»Ÿç“¶é¢ˆ
- å‡å°‘èµ„æºæ¶ˆè€—

**å®è·µå»ºè®®**ï¼š
```yaml
# âœ… å¥½çš„åšæ³•ï¼šè½»é‡çº§HTTPæ£€æŸ¥
livenessProbe:
  httpGet:
    path: /ping      # ç®€å•çš„pingæ¥å£
    port: 8080
  timeoutSeconds: 1  # çŸ­è¶…æ—¶æ—¶é—´

# âŒ é¿å…çš„åšæ³•ï¼šå¤æ‚çš„æ£€æŸ¥é€»è¾‘  
livenessProbe:
  exec:
    command:
    - /bin/sh
    - -c
    - "complex-database-query.sh"  # å¤æ‚è€—æ—¶æ“ä½œ
```

**ğŸ”¸ ä¸“é—¨åŒ–åŸåˆ™**

ä¸åŒæ¢é’ˆåº”è¯¥æ£€æŸ¥ä¸åŒçš„å¥åº·çŠ¶æ€ï¼š

```
å¯åŠ¨æ¢é’ˆ â†’ æ£€æŸ¥åŸºç¡€å¯åŠ¨å®Œæˆ
        â”œâ”€â”€ åº”ç”¨è¿›ç¨‹å¯åŠ¨
        â”œâ”€â”€ é…ç½®æ–‡ä»¶åŠ è½½
        â””â”€â”€ åŸºç¡€ä¾èµ–è¿æ¥

å­˜æ´»æ¢é’ˆ â†’ æ£€æŸ¥æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
        â”œâ”€â”€ åº”ç”¨ä¸»è¦åŠŸèƒ½å¯ç”¨
        â”œâ”€â”€ é¿å…æ­»é”å’Œå¡æ­»
        â””â”€â”€ å†…å­˜æ²¡æœ‰æ³„æ¼

å°±ç»ªæ¢é’ˆ â†’ æ£€æŸ¥æœåŠ¡å®Œå…¨å¯ç”¨
        â”œâ”€â”€ æ‰€æœ‰å¤–éƒ¨ä¾èµ–æ­£å¸¸
        â”œâ”€â”€ ç¼“å­˜é¢„çƒ­å®Œæˆ
        â””â”€â”€ å¯ä»¥å¤„ç†ç”Ÿäº§æµé‡
```

### 7.2 å¥åº·æ£€æŸ¥ç«¯ç‚¹è®¾è®¡


**ğŸ”§ æ¨èçš„ç«¯ç‚¹è®¾è®¡**

```go
// ç¤ºä¾‹ï¼šGoè¯­è¨€å¥åº·æ£€æŸ¥ç«¯ç‚¹è®¾è®¡
func healthCheckHandler(w http.ResponseWriter, r *http.Request) {
    checks := []Check{
        checkDatabase(),
        checkRedis(), 
        checkExternalAPI(),
    }
    
    allHealthy := true
    result := make(map[string]string)
    
    for _, check := range checks {
        if check.Error != nil {
            allHealthy = false
            result[check.Name] = "unhealthy: " + check.Error.Error()
        } else {
            result[check.Name] = "healthy"
        }
    }
    
    if allHealthy {
        w.WriteHeader(200)
    } else {
        w.WriteHeader(503)  // Service Unavailable
    }
    
    json.NewEncoder(w).Encode(result)
}
```

**ğŸ“‹ ä¸åŒç«¯ç‚¹çš„èŒè´£åˆ†å·¥**

| ç«¯ç‚¹ | **æ£€æŸ¥å†…å®¹** | **å“åº”æ—¶é—´è¦æ±‚** | **å¤±è´¥å½±å“** |
|-----|------------|----------------|-------------|
| `/ping` | `åº”ç”¨åŸºç¡€å¯ç”¨æ€§` | `< 100ms` | `å­˜æ´»æ¢é’ˆä½¿ç”¨` |
| `/health/live` | `æ ¸å¿ƒåŠŸèƒ½çŠ¶æ€` | `< 500ms` | `å®¹å™¨é‡å¯` |
| `/health/ready` | `å®Œæ•´æœåŠ¡å¯ç”¨æ€§` | `< 1000ms` | `æµé‡ç§»é™¤` |
| `/health/startup` | `å¯åŠ¨çŠ¶æ€æ£€æŸ¥` | `< 2000ms` | `å¯åŠ¨å¤±è´¥` |

### 7.3 å‚æ•°è°ƒä¼˜æŒ‡å—


**ğŸ¯ ä¸åŒç¯å¢ƒçš„å‚æ•°å»ºè®®**

```yaml
# å¼€å‘ç¯å¢ƒï¼šå¿«é€Ÿåé¦ˆ
development:
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 2
  failureThreshold: 2

# æµ‹è¯•ç¯å¢ƒï¼šå¹³è¡¡é…ç½®
testing:
  initialDelaySeconds: 10
  periodSeconds: 10  
  timeoutSeconds: 3
  failureThreshold: 3

# ç”Ÿäº§ç¯å¢ƒï¼šç¨³å®šä¼˜å…ˆ
production:
  initialDelaySeconds: 30
  periodSeconds: 15
  timeoutSeconds: 5
  failureThreshold: 5
```

**âš ï¸ è°ƒä¼˜æ³¨æ„äº‹é¡¹**

1. **æ¸è¿›å¼è°ƒä¼˜**ï¼šä»å®½æ¾é…ç½®å¼€å§‹ï¼Œé€æ­¥æ”¶ç´§
2. **ç›‘æ§æ•°æ®é©±åŠ¨**ï¼šåŸºäºå®é™…è¿è¡Œæ•°æ®è°ƒæ•´å‚æ•°
3. **A/Bæµ‹è¯•**ï¼šåœ¨éå…³é”®ç¯å¢ƒå…ˆæµ‹è¯•æ–°é…ç½®
4. **æ–‡æ¡£è®°å½•**ï¼šè®°å½•æ¯æ¬¡è°ƒæ•´çš„åŸå› å’Œæ•ˆæœ

### 7.4 å¸¸è§é™·é˜±é¿å…


**ğŸš« é™·é˜±1ï¼šè¿‡åº¦æ£€æŸ¥**

```yaml
# âŒ é”™è¯¯ï¼šæ£€æŸ¥è¿‡äºé¢‘ç¹
livenessProbe:
  periodSeconds: 1       # æ¯ç§’æ£€æŸ¥ï¼Œå¤ªé¢‘ç¹
  timeoutSeconds: 10     # è¶…æ—¶æ—¶é—´è¿‡é•¿
  failureThreshold: 1    # ä¸€æ¬¡å¤±è´¥å°±é‡å¯
```

**âœ… æ­£ç¡®åšæ³•**ï¼š
- æ£€æŸ¥é—´éš”è‡³å°‘5ç§’ä»¥ä¸Š
- è¶…æ—¶æ—¶é—´è¦åˆç†
- ç»™äºˆè¶³å¤Ÿçš„å®¹é”™æ¬¡æ•°

**ğŸš« é™·é˜±2ï¼šæ¢é’ˆç›¸äº’å¹²æ‰°**

```yaml
# âŒ é”™è¯¯ï¼šæ‰€æœ‰æ¢é’ˆä½¿ç”¨ç›¸åŒç«¯ç‚¹
startupProbe:
  httpGet:
    path: /health    # åŒä¸€ä¸ªç«¯ç‚¹
readinessProbe:
  httpGet:
    path: /health    # åŒä¸€ä¸ªç«¯ç‚¹
livenessProbe:
  httpGet: 
    path: /health    # åŒä¸€ä¸ªç«¯ç‚¹
```

**âœ… æ­£ç¡®åšæ³•**ï¼š
- ä¸ºä¸åŒæ¢é’ˆè®¾è®¡ä¸“é—¨çš„æ£€æŸ¥ç«¯ç‚¹
- é¿å…å¤æ‚æ£€æŸ¥å½±å“å…¶ä»–æ¢é’ˆ

**ğŸš« é™·é˜±3ï¼šå¿½ç•¥åº”ç”¨ç‰¹æ€§**

```yaml
# âŒ é”™è¯¯ï¼šæ•°æ®åº“åº”ç”¨ä½¿ç”¨è¿‡çŸ­å¯åŠ¨æ—¶é—´
startupProbe:
  initialDelaySeconds: 10  # æ•°æ®åº“å¯åŠ¨éœ€è¦æ›´é•¿æ—¶é—´
  failureThreshold: 3      # å¯åŠ¨çª—å£å¤ªçŸ­
```

**âœ… æ­£ç¡®åšæ³•**ï¼š
- äº†è§£åº”ç”¨çš„å®é™…å¯åŠ¨æ—¶é—´
- ä¸ºä¸åŒç±»å‹åº”ç”¨è®¾è®¡ä¸åŒé…ç½®
- åœ¨å®é™…ç¯å¢ƒä¸­éªŒè¯é…ç½®æœ‰æ•ˆæ€§

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ ä¸‰ç§æ¢é’ˆçš„æœ¬è´¨åŒºåˆ«ï¼š
- å¯åŠ¨æ¢é’ˆï¼šæ£€æŸ¥"å¯åŠ¨å®Œæˆ" â†’ ä¸€æ¬¡æ€§æ£€æŸ¥
- å­˜æ´»æ¢é’ˆï¼šæ£€æŸ¥"è¿˜æ´»ç€" â†’ å¤±è´¥ä¼šé‡å¯å®¹å™¨  
- å°±ç»ªæ¢é’ˆï¼šæ£€æŸ¥"å‡†å¤‡å¥½" â†’ å¤±è´¥ä¼šç§»é™¤æµé‡

ğŸ”§ ä¸‰ç§æ£€æŸ¥æ–¹å¼ï¼š
- HTTP GETï¼šé€‚åˆWebåº”ç”¨ï¼Œæ£€æŸ¥HTTPå“åº”
- TCP Socketï¼šé€‚åˆæ•°æ®åº“ï¼Œæ£€æŸ¥ç«¯å£è¿é€š
- Execå‘½ä»¤ï¼šæœ€çµæ´»ï¼Œå¯æ‰§è¡Œè‡ªå®šä¹‰æ£€æŸ¥

âš™ï¸ æ ¸å¿ƒå‚æ•°ï¼š
- initialDelaySecondsï¼šç»™åº”ç”¨è¶³å¤Ÿå¯åŠ¨æ—¶é—´
- periodSecondsï¼šæ£€æŸ¥é¢‘ç‡è¦åˆç†
- timeoutSecondsï¼šç»™æ£€æŸ¥æ“ä½œè¶³å¤Ÿæ—¶é—´  
- failureThresholdï¼šå®¹é”™æ¬¡æ•°é¿å…è¯¯åˆ¤
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¢é’ˆä¸æ˜¯ä¸‡èƒ½çš„**
```
æ¢é’ˆåªèƒ½æ£€æµ‹åˆ°ï¼š
âœ… åº”ç”¨è¿›ç¨‹çŠ¶æ€
âœ… ç«¯å£è¿é€šæ€§
âœ… HTTPå“åº”çŠ¶æ€
âœ… è‡ªå®šä¹‰æ£€æŸ¥ç»“æœ

æ¢é’ˆæ£€æµ‹ä¸åˆ°ï¼š
âŒ åº”ç”¨ä¸šåŠ¡é€»è¾‘é”™è¯¯
âŒ æ•°æ®ä¸€è‡´æ€§é—®é¢˜  
âŒ æ€§èƒ½ä¸‹é™é—®é¢˜
âŒ å†…å­˜æ³„æ¼ï¼ˆé™¤éå¾ˆä¸¥é‡ï¼‰
```

**ğŸ”¹ å‚æ•°é…ç½®çš„è‰ºæœ¯**
```
è¿‡äºä¸¥æ ¼ï¼š
- ç½‘ç»œæŠ–åŠ¨å¯¼è‡´è¯¯åˆ¤
- åº”ç”¨ä¸´æ—¶ç¹å¿™è¢«é‡å¯
- ç³»ç»Ÿç¨³å®šæ€§ä¸‹é™

è¿‡äºå®½æ¾ï¼š
- æ•…éšœå‘ç°æ…¢
- å½±å“ç”¨æˆ·ä½“éªŒ
- é—®é¢˜è¢«æ©ç›–

æœ€ä½³å¹³è¡¡ï¼š
- åŸºäºå®é™…è¿è¡Œæ•°æ®è°ƒä¼˜
- ä¸åŒç¯å¢ƒä¸åŒé…ç½®
- æ¸è¿›å¼è°ƒæ•´ç­–ç•¥
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**
1. **è‡ªåŠ¨æ•…éšœæ¢å¤**ï¼šæ— éœ€äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨é‡å¯æ•…éšœå®¹å™¨
2. **æµé‡æ™ºèƒ½è°ƒåº¦**ï¼šè‡ªåŠ¨ç§»é™¤ä¸å¥åº·çš„Podï¼Œç¡®ä¿ç”¨æˆ·è®¿é—®æ­£å¸¸Pod
3. **æ»šåŠ¨æ›´æ–°ä¿éšœ**ï¼šç¡®ä¿æ–°ç‰ˆæœ¬å®Œå…¨å°±ç»ªåæ‰æ¥æ”¶æµé‡
4. **ç³»ç»Ÿå¯è§‚æµ‹æ€§**ï¼šé€šè¿‡æ¢é’ˆçŠ¶æ€äº†è§£åº”ç”¨å¥åº·çŠ¶å†µ

**ğŸ¯ æœ€ä½³å®è·µæ€»ç»“**
1. **è½»é‡çº§æ£€æŸ¥**ï¼šæ¢é’ˆæ£€æŸ¥è¦å¿«é€Ÿç®€å•
2. **ä¸“é—¨åŒ–è®¾è®¡**ï¼šä¸åŒæ¢é’ˆæ£€æŸ¥ä¸åŒçŠ¶æ€
3. **å‚æ•°åˆç†åŒ–**ï¼šåŸºäºåº”ç”¨ç‰¹æ€§é…ç½®å‚æ•°
4. **ç›‘æ§å‘Šè­¦åŒ–**ï¼šç»“åˆç›‘æ§ç³»ç»ŸåŠæ—¶å‘ç°é—®é¢˜
5. **æ¸è¿›å¼ä¼˜åŒ–**ï¼šåœ¨å®é™…ç¯å¢ƒä¸­æŒç»­ä¼˜åŒ–é…ç½®

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¥åº·æ£€æŸ¥æ˜¯K8sè‡ªæ„ˆèƒ½åŠ›çš„åŸºç¡€
- ä¸‰ç§æ¢é’ˆå„å¸å…¶èŒï¼ŒååŒå·¥ä½œ
- å‚æ•°é…ç½®éœ€è¦å¹³è¡¡å‡†ç¡®æ€§å’Œç¨³å®šæ€§
- å®è·µä¸­æŒç»­ä¼˜åŒ–æ¯”ä¸€æ¬¡æ€§å®Œç¾é…ç½®æ›´é‡è¦