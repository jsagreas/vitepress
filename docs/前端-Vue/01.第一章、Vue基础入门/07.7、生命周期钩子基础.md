---
title: 7、生命周期钩子基础
---
## 📚 目录

1. [什么是生命周期钩子](#1-什么是生命周期钩子)
2. [创建阶段钩子](#2-创建阶段钩子)
3. [挂载阶段钩子](#3-挂载阶段钩子)
4. [更新阶段钩子](#4-更新阶段钩子)
5. [销毁阶段钩子](#5-销毁阶段钩子)
6. [生命周期执行顺序](#6-生命周期执行顺序)
7. [实际应用场景](#7-实际应用场景)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌱 什么是生命周期钩子


### 1.1 生命周期概念


**通俗理解**：就像人的一生有"出生→成长→工作→死亡"这样的阶段，Vue组件也有自己的"生命历程"

```
人的生命阶段：
👶 出生 → 🧒 成长 → 👨 工作 → 💀 死亡

Vue组件生命阶段：
🔧 创建 → 📱 挂载 → 🔄 更新 → 💀 销毁
```

**生命周期钩子**：就是在组件生命的关键时刻，Vue给你提供的"机会"，让你可以在这些时刻执行自己的代码。

### 1.2 为什么需要生命周期钩子


> 💡 **比喻理解**：
> 就像你搬新家时，需要在"搬家前打包"、"入住后买家具"、"要搬走时清理"
> Vue组件也需要在"创建时初始化数据"、"显示后获取数据"、"销毁前清理资源"

**实际需求场景**：
- 📊 **组件显示后**：从服务器获取数据
- 🕐 **组件创建时**：设置定时器
- 🧹 **组件销毁前**：清理定时器，避免内存泄漏
- 📈 **数据改变后**：更新图表显示

### 1.3 Vue生命周期全景图


```
组件生命周期流程：

开始
 ↓
🔧 创建阶段
├── beforeCreate  (还没有数据)
└── created      (有数据了，但还没显示)
 ↓
📱 挂载阶段  
├── beforeMount  (准备显示)
└── mounted     (已经显示在页面上)
 ↓
🔄 更新阶段 (数据变化时才执行)
├── beforeUpdate (数据变了，页面还没更新)
└── updated     (页面也更新了)
 ↓
💀 销毁阶段
├── beforeUnmount (准备销毁)
└── unmounted    (彻底销毁)
```

---

## 2. 🔧 创建阶段钩子


### 2.1 beforeCreate - "还在孕育期"


**含义**：组件实例刚刚创建，但是还"什么都没有"

```javascript
export default {
  beforeCreate() {
    // 这时候啥都没有！
    console.log('beforeCreate：我还在孕育期')
    console.log(this.message) // undefined - 没有数据
    console.log(this.$el)     // undefined - 没有DOM
  },
  
  data() {
    return {
      message: 'Hello Vue!'
    }
  }
}
```

**特点**：
- ❌ **没有数据**：访问不到 `data` 中的属性
- ❌ **没有方法**：访问不到 `methods` 中的方法  
- ❌ **没有DOM**：访问不到 `$el`

**使用场景**：
- 🔧 **插件初始化**：安装一些不依赖数据的插件
- 📊 **性能监控**：记录组件创建开始时间

### 2.2 created - "有血有肉了"


**含义**：组件的数据、方法都准备好了，但还没有显示到页面上

```javascript
export default {
  data() {
    return {
      userList: [],
      loading: true
    }
  },
  
  created() {
    console.log('created：我有数据了！')
    console.log(this.message)   // 'Hello Vue!' - 有数据了
    console.log(this.$el)       // undefined - 还没有DOM
    
    // 🎯 最常用：获取初始数据
    this.fetchUserData()
  },
  
  methods: {
    fetchUserData() {
      // 调用API获取用户数据
      api.getUsers().then(users => {
        this.userList = users
        this.loading = false
      })
    }
  }
}
```

**特点**：
- ✅ **有数据**：可以访问 `data`、`computed`、`methods`
- ❌ **没有DOM**：还没有挂载到页面，访问不到 `$el`

**使用场景**：
- 🌐 **API调用**：获取页面初始数据
- 🔧 **数据初始化**：设置初始状态
- 📊 **事件监听**：添加全局事件监听器

> 📝 **记忆技巧**：created = "有数据，没页面"

---

## 3. 📱 挂载阶段钩子


### 3.1 beforeMount - "准备上台表演"


**含义**：模板编译完成，准备挂载到页面，但还没有真正显示

```javascript
export default {
  beforeMount() {
    console.log('beforeMount：准备显示到页面')
    console.log(this.$el)  // undefined - 还没挂载
  }
}
```

**特点**：
- ✅ **有数据**：可以访问组件数据
- ❌ **没有DOM**：虚拟DOM创建了，但还没有真实DOM

**使用场景**：
- 🔧 **最后准备**：挂载前的最后准备工作
- 📊 **性能监控**：记录挂载开始时间

### 3.2 mounted - "正式登台亮相"


**含义**：组件已经显示在页面上，可以操作DOM了

```javascript
export default {
  data() {
    return {
      chart: null
    }
  },
  
  mounted() {
    console.log('mounted：我出现在页面上了！')
    console.log(this.$el)  // 真实的DOM元素
    
    // 🎯 可以操作DOM了
    this.initChart()
    this.focusInput()
  },
  
  methods: {
    initChart() {
      // 初始化图表 - 需要真实DOM
      this.chart = new Chart(this.$refs.chartCanvas, {
        type: 'line',
        data: this.chartData
      })
    },
    
    focusInput() {
      // 让输入框获得焦点
      this.$refs.nameInput.focus()
    }
  }
}
```

**特点**：
- ✅ **有数据**：组件数据完全可用
- ✅ **有DOM**：可以访问和操作真实DOM

**使用场景**：
- 🎨 **DOM操作**：操作DOM元素
- 📊 **第三方库初始化**：图表、地图等需要DOM的库
- 🔍 **元素聚焦**：让某个输入框获得焦点
- 📏 **获取元素尺寸**：获取DOM元素的宽高等信息

> 📝 **记忆技巧**：mounted = "有数据，有页面，能操作DOM"

---

## 4. 🔄 更新阶段钩子


### 4.1 beforeUpdate - "准备换装"


**含义**：数据发生变化，准备更新页面，但页面还没有重新渲染

```javascript
export default {
  data() {
    return {
      count: 0
    }
  },
  
  beforeUpdate() {
    console.log('beforeUpdate：数据变了，准备更新页面')
    console.log('DOM中的值：', this.$el.textContent)  // 还是旧值
    console.log('数据中的值：', this.count)           // 已经是新值
  },
  
  updated() {
    console.log('updated：页面也更新了')
    console.log('DOM中的值：', this.$el.textContent)  // 变成新值了
  }
}
```

**特点**：
- ✅ **数据是新的**：组件数据已经更新
- ❌ **DOM是旧的**：页面还没有重新渲染

**使用场景**：
- 📊 **获取更新前状态**：记录更新前的DOM状态
- 🔧 **准备工作**：为页面更新做准备

### 4.2 updated - "换装完成"


**含义**：数据变化后，页面也重新渲染完成了

```javascript
export default {
  data() {
    return {
      list: ['苹果', '香蕉']
    }
  },
  
  updated() {
    console.log('updated：页面更新完成')
    
    // 🎯 DOM已经更新，可以获取新的DOM信息
    this.adjustScrollPosition()
    this.updateThirdPartyPlugin()
  },
  
  methods: {
    adjustScrollPosition() {
      // 列表更新后，调整滚动位置
      const container = this.$refs.listContainer
      container.scrollTop = container.scrollHeight
    },
    
    updateThirdPartyPlugin() {
      // 通知第三方插件数据已更新
      if (this.chart) {
        this.chart.update()
      }
    }
  }
}
```

**特点**：
- ✅ **数据是新的**：组件数据已经更新
- ✅ **DOM是新的**：页面已经重新渲染

**使用场景**：
- 📏 **获取新DOM信息**：获取更新后的元素尺寸
- 🎨 **调整DOM样式**：根据新内容调整样式
- 🔧 **第三方库更新**：通知第三方库数据已更新

> ⚠️ **注意**：不要在 `updated` 中修改数据，会造成无限循环更新！

---

## 5. 💀 销毁阶段钩子


### 5.1 beforeUnmount - "准备告别" (Vue 3)


**含义**：组件准备被销毁，但还没有真正销毁，所有功能仍然正常

```javascript
export default {
  data() {
    return {
      timer: null
    }
  },
  
  mounted() {
    // 设置定时器
    this.timer = setInterval(() => {
      console.log('定时器执行')
    }, 1000)
  },
  
  beforeUnmount() {
    console.log('beforeUnmount：准备告别了')
    
    // 🧹 清理工作 - 组件功能还正常
    if (this.timer) {
      clearInterval(this.timer)
      console.log('定时器已清理')
    }
    
    // 移除全局事件监听
    window.removeEventListener('resize', this.handleResize)
  }
}
```

### 5.2 unmounted - "彻底告别" (Vue 3)


**含义**：组件已经被完全销毁，所有东西都不存在了

```javascript
export default {
  unmounted() {
    console.log('unmounted：我彻底消失了')
    // 这里一般只做日志记录，因为组件已经销毁
  }
}
```

### 5.3 Vue 2 兼容说明


**Vue 2 中的销毁钩子**：
- `beforeDestroy` = Vue 3 的 `beforeUnmount`
- `destroyed` = Vue 3 的 `unmounted`

```javascript
// Vue 2 写法
export default {
  beforeDestroy() {
    // 清理工作
  },
  destroyed() {
    // 销毁完成
  }
}

// Vue 3 写法  
export default {
  beforeUnmount() {
    // 清理工作
  },
  unmounted() {
    // 销毁完成
  }
}
```

**清理工作清单**：
- 🕐 **定时器**：`clearInterval`、`clearTimeout`
- 📡 **事件监听**：移除全局事件监听器
- 🔌 **第三方库**：销毁图表、地图等实例
- 📊 **WebSocket**：关闭连接
- 🧹 **内存清理**：解除大对象引用

---

## 6. ⏰ 生命周期执行顺序


### 6.1 完整执行时序


```
组件从创建到销毁的完整流程：

🚀 组件开始创建
    ↓
📋 beforeCreate    (还没有数据和方法)
    ↓
🔧 初始化 data、methods、computed 等
    ↓  
📋 created        (有数据了，还没DOM)
    ↓
🖼️ 编译模板
    ↓
📋 beforeMount    (准备挂载到DOM)
    ↓
🔗 挂载到真实DOM
    ↓
📋 mounted        (已显示在页面，可操作DOM)
    ↓
🔄 等待数据变化...
    ↓ (当数据变化时)
📋 beforeUpdate   (数据新，DOM旧)
    ↓
🔄 重新渲染DOM
    ↓
📋 updated        (数据新，DOM新)
    ↓
🔄 继续等待...
    ↓ (当组件被销毁时)
📋 beforeUnmount  (准备销毁，功能正常)
    ↓
💥 销毁组件实例
    ↓
📋 unmounted      (彻底销毁)
```

### 6.2 父子组件生命周期顺序


```
父子组件嵌套时的执行顺序：

创建阶段：
👨 父 beforeCreate
👨 父 created
👨 父 beforeMount
    👶 子 beforeCreate
    👶 子 created  
    👶 子 beforeMount
    👶 子 mounted
👨 父 mounted

更新阶段（父组件数据变化）：
👨 父 beforeUpdate
    👶 子 beforeUpdate
    👶 子 updated
👨 父 updated

销毁阶段：
👨 父 beforeUnmount
    👶 子 beforeUnmount
    👶 子 unmounted
👨 父 unmounted
```

> 📝 **记忆规律**：创建时"父→子"，销毁时"子→父"，就像搭积木和拆积木

---

## 7. 🎯 实际应用场景


### 7.1 常见应用场景总结


| 生命周期钩子 | 💡 **主要用途** | 🎯 **典型场景** |
|-------------|----------------|----------------|
| **created** | 获取初始数据 | API调用、数据初始化 |
| **mounted** | DOM操作和第三方库 | 图表初始化、聚焦元素 |
| **beforeUpdate** | 获取更新前状态 | 记录滚动位置 |
| **updated** | 响应DOM更新 | 调整布局、更新插件 |
| **beforeUnmount** | 清理资源 | 清理定时器、移除监听器 |

### 7.2 实战示例：用户列表组件


```javascript
export default {
  name: 'UserList',
  
  data() {
    return {
      users: [],
      loading: true,
      timer: null,
      chart: null
    }
  },
  
  // 1️⃣ 获取用户数据
  created() {
    console.log('🔧 开始获取用户数据')
    this.fetchUsers()
    
    // 设置定时刷新
    this.timer = setInterval(this.fetchUsers, 30000)
  },
  
  // 2️⃣ 初始化图表
  mounted() {
    console.log('📱 页面已显示，初始化图表')
    this.initChart()
    
    // 让搜索框获得焦点
    this.$refs.searchInput.focus()
  },
  
  // 3️⃣ 数据更新后重新渲染图表
  updated() {
    console.log('🔄 数据更新了，刷新图表')
    if (this.chart) {
      this.chart.updateData(this.users)
    }
  },
  
  // 4️⃣ 组件销毁前清理
  beforeUnmount() {
    console.log('🧹 清理定时器和图表')
    
    // 清理定时器
    if (this.timer) {
      clearInterval(this.timer)
    }
    
    // 销毁图表
    if (this.chart) {
      this.chart.destroy()
    }
  },
  
  methods: {
    async fetchUsers() {
      try {
        this.loading = true
        const response = await api.getUsers()
        this.users = response.data
      } catch (error) {
        console.error('获取用户失败：', error)
      } finally {
        this.loading = false
      }
    },
    
    initChart() {
      this.chart = new Chart(this.$refs.chartCanvas, {
        type: 'bar',
        data: {
          labels: this.users.map(u => u.name),
          datasets: [{
            data: this.users.map(u => u.score)
          }]
        }
      })
    }
  }
}
```

### 7.3 最佳实践 Checklist


**✅ 推荐做法**：
- **created**：获取数据、设置初始状态
- **mounted**：DOM操作、第三方库初始化  
- **beforeUnmount**：清理定时器、移除监听器
- **适度使用**：不是每个钩子都要用

**❌ 避免的做法**：
- 在 `updated` 中修改数据（无限循环）
- 忘记清理定时器（内存泄漏）
- 在 `beforeCreate` 中访问数据（会报错）
- 过度使用生命周期钩子

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本概念


```
🔸 生命周期：组件从创建到销毁的完整流程
🔸 钩子函数：在生命周期关键时刻执行的函数
🔸 执行顺序：创建→挂载→更新→销毁
🔸 父子顺序：创建时父→子，销毁时子→父
🔸 核心应用：数据获取、DOM操作、资源清理
```

### 8.2 关键理解要点


**🔹 各阶段特点对比**：
```
beforeCreate：啥都没有
created：有数据，没DOM  
mounted：有数据，有DOM
updated：数据和DOM都是最新的
beforeUnmount：准备销毁，功能正常
```

**🔹 最常用的三个钩子**：
- **created**：获取数据 📊
- **mounted**：操作DOM 🎨  
- **beforeUnmount**：清理资源 🧹

**🔹 记忆技巧**：
```
created = "我有数据了"
mounted = "我上台了"  
updated = "我换装了"
beforeUnmount = "我要下台了"
```

### 8.3 实际开发指导


**📊 数据获取时机**：
- **静态数据**：`created` 中获取
- **依赖DOM的数据**：`mounted` 中获取

**🎨 DOM操作时机**：
- **一次性操作**：`mounted` 中执行
- **响应式操作**：`updated` 中执行

**🧹 清理工作时机**：
- **所有清理**：都在 `beforeUnmount` 中进行

**核心记忆**：
- 生命周期像人的一生，每个阶段都有该做的事
- created获取数据，mounted操作DOM，beforeUnmount清理资源
- 不要在错误的时机做事，会出问题
- 记住清理工作，避免内存泄漏