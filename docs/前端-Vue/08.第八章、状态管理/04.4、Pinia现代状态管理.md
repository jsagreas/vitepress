---
title: 4ã€Piniaç°ä»£çŠ¶æ€ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [Piniaæ˜¯ä»€ä¹ˆ](#1-Piniaæ˜¯ä»€ä¹ˆ)
2. [å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨](#2-å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨)
3. [defineStoreå®šä¹‰å­˜å‚¨](#3-defineStoreå®šä¹‰å­˜å‚¨)
4. [stateçŠ¶æ€ç®¡ç†](#4-stateçŠ¶æ€ç®¡ç†)
5. [gettersè®¡ç®—çŠ¶æ€](#5-gettersè®¡ç®—çŠ¶æ€)
6. [actionsçŠ¶æ€ä¿®æ”¹](#6-actionsçŠ¶æ€ä¿®æ”¹)
7. [çŠ¶æ€æ›´æ–°æŠ€å·§](#7-çŠ¶æ€æ›´æ–°æŠ€å·§)
8. [çŠ¶æ€è®¢é˜…ç›‘å¬](#8-çŠ¶æ€è®¢é˜…ç›‘å¬)
9. [çŠ¶æ€æŒä¹…åŒ–](#9-çŠ¶æ€æŒä¹…åŒ–)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ Piniaæ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£

> ğŸ’¡ **ç®€å•æ¯”å–»**ï¼šPiniaå°±åƒä¸€ä¸ª**å…¬å…±ä»“åº“**ï¼Œä¸“é—¨å­˜æ”¾æ•´ä¸ªåº”ç”¨éƒ½éœ€è¦ç”¨åˆ°çš„æ•°æ®ã€‚å°±åƒå®¶é‡Œçš„å‚¨ç‰©é—´ï¼Œæ‰€æœ‰æˆ¿é—´éƒ½èƒ½æ¥è¿™é‡Œå–ä¸œè¥¿ã€æ”¾ä¸œè¥¿ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦Piniaï¼Ÿ**
```
æ²¡æœ‰çŠ¶æ€ç®¡ç†çš„é—®é¢˜ï¼š
çˆ·çˆ·ç»„ä»¶ â†’ çˆ¸çˆ¸ç»„ä»¶ â†’ å„¿å­ç»„ä»¶ â†’ å­™å­ç»„ä»¶
æ•°æ®è¦ä¸€å±‚å±‚ä¼ é€’ï¼Œå¾ˆéº»çƒ¦ï¼

æœ‰äº†Piniaï¼š
æ‰€æœ‰ç»„ä»¶ â†â†’ Piniaä»“åº“
ç›´æ¥å­˜å–æ•°æ®ï¼Œç®€å•é«˜æ•ˆï¼
```

### 1.2 æ ¸å¿ƒç‰¹ç‚¹

- âœ… **è½»é‡ç®€å•**ï¼šæ¯”Vuexæ›´å®¹æ˜“ç†è§£å’Œä½¿ç”¨
- âœ… **TypeScriptå‹å¥½**ï¼šå¤©ç„¶æ”¯æŒç±»å‹æç¤º
- âœ… **å¼€å‘å·¥å…·**ï¼šå®Œç¾æ”¯æŒVue DevTools
- âœ… **æ¨¡å—åŒ–**ï¼šæ¯ä¸ªstoreç‹¬ç«‹ç®¡ç†
- âœ… **æ’ä»¶ç³»ç»Ÿ**ï¼šæ”¯æŒæŒä¹…åŒ–ç­‰æ‰©å±•

### 1.3 ä¸Vuexçš„åŒºåˆ«

| ç‰¹æ€§ | **Vuex** | **Pinia** |
|------|----------|-----------|
| **å­¦ä¹ éš¾åº¦** | å¤æ‚ï¼Œæ¦‚å¿µå¤š | ç®€å•ï¼Œç›´è§‚ |
| **TypeScript** | éœ€è¦é¢å¤–é…ç½® | åŸç”Ÿæ”¯æŒ |
| **æ¨¡å—åŒ–** | namespaceæ¨¡å¼ | å¤©ç„¶æ¨¡å—åŒ– |
| **ä»£ç é‡** | è¾ƒå¤šæ ·æ¿ä»£ç  | ä»£ç ç®€æ´ |
| **Vue3æ”¯æŒ** | å…¼å®¹æ€§æ–¹æ¡ˆ | ä¸“ä¸ºVue3è®¾è®¡ |

---

## 2. ğŸ“¦ å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨


### 2.1 å®‰è£…Pinia

```bash
# ä½¿ç”¨npmå®‰è£…
npm install pinia

# ä½¿ç”¨yarnå®‰è£…
yarn add pinia
```

### 2.2 åŸºç¡€é…ç½®

```javascript
// main.js - åº”ç”¨å…¥å£æ–‡ä»¶
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import App from './App.vue'

// åˆ›å»ºåº”ç”¨å®ä¾‹
const app = createApp(App)

// åˆ›å»ºPiniaå®ä¾‹å¹¶ä½¿ç”¨
const pinia = createPinia()
app.use(pinia)

app.mount('#app')
```

> ğŸ’¡ **é…ç½®è¯´æ˜**ï¼šå°±åƒç»™Vueåº”ç”¨è£…äº†ä¸€ä¸ª**æ•°æ®ç®¡ç†å™¨**ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½èƒ½ä½¿ç”¨è¿™ä¸ªç®¡ç†å™¨æ¥å­˜å–æ•°æ®ã€‚

### 2.3 é¡¹ç›®ç»“æ„å»ºè®®

```
src/
â”œâ”€â”€ stores/           # å­˜å‚¨æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ user.js      # ç”¨æˆ·ç›¸å…³çŠ¶æ€
â”‚   â”œâ”€â”€ cart.js      # è´­ç‰©è½¦çŠ¶æ€
â”‚   â””â”€â”€ index.js     # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ components/
â””â”€â”€ views/
```

---

## 3. ğŸª defineStoreå®šä¹‰å­˜å‚¨


### 3.1 åŸºæœ¬è¯­æ³•

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼š`defineStore`å°±æ˜¯**åˆ›å»ºä¸€ä¸ªæ•°æ®ä»“åº“**ï¼Œç»™ä»“åº“èµ·ä¸ªåå­—ï¼Œç„¶åå®šä¹‰é‡Œé¢å­˜ä»€ä¹ˆæ•°æ®ã€æ€ä¹ˆè®¡ç®—ã€æ€ä¹ˆä¿®æ”¹ã€‚

```javascript
// stores/counter.js
import { defineStore } from 'pinia'

// å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ä»“åº“
export const useCounterStore = defineStore('counter', {
  // çŠ¶æ€æ•°æ®ï¼ˆç›¸å½“äºdataï¼‰
  state: () => ({
    count: 0,
    name: 'è®¡æ•°å™¨'
  }),
  
  // è®¡ç®—å±æ€§ï¼ˆç›¸å½“äºcomputedï¼‰
  getters: {
    doubleCount: (state) => state.count * 2
  },
  
  // æ–¹æ³•ï¼ˆç›¸å½“äºmethodsï¼‰
  actions: {
    increment() {
      this.count++
    }
  }
})
```

### 3.2 å‘½åçº¦å®š

```javascript
// âœ… æ¨èçš„å‘½åæ–¹å¼
export const useUserStore = defineStore('user', { ... })
export const useCartStore = defineStore('cart', { ... })
export const useProductStore = defineStore('product', { ... })

// ä½¿ç”¨æ—¶
const userStore = useUserStore()
const cartStore = useCartStore()
```

> ğŸ“ **å‘½åè¯´æ˜**ï¼š
> - storeåå­—ç”¨`useå¼€å¤´Storeç»“å°¾`ï¼Œè¿™æ˜¯Vueçš„æƒ¯ä¾‹
> - ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯storeçš„å”¯ä¸€æ ‡è¯†ï¼Œé€šå¸¸å’Œæ–‡ä»¶åä¿æŒä¸€è‡´

### 3.3 ç»„åˆå¼APIå†™æ³•

```javascript
// æ›´çµæ´»çš„å†™æ³•ï¼ˆæ¨èï¼‰
export const useCounterStore = defineStore('counter', () => {
  // çŠ¶æ€
  const count = ref(0)
  const name = ref('è®¡æ•°å™¨')
  
  // è®¡ç®—å±æ€§
  const doubleCount = computed(() => count.value * 2)
  
  // æ–¹æ³•
  function increment() {
    count.value++
  }
  
  // å¿…é¡»è¿”å›è¦æš´éœ²çš„å†…å®¹
  return {
    count,
    name,
    doubleCount,
    increment
  }
})
```

---

## 4. ğŸ“Š stateçŠ¶æ€ç®¡ç†


### 4.1 çŠ¶æ€å®šä¹‰

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šstateå°±æ˜¯**ä»“åº“é‡Œå­˜æ”¾çš„å…·ä½“ç‰©å“**ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€è´­ç‰©è½¦å•†å“ã€å½“å‰é¡µé¢ç­‰ã€‚

```javascript
// stores/user.js
export const useUserStore = defineStore('user', {
  state: () => ({
    // ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
    userInfo: {
      id: null,
      name: '',
      avatar: '',
      email: ''
    },
    
    // ç™»å½•çŠ¶æ€
    isLoggedIn: false,
    
    // ç”¨æˆ·æƒé™
    permissions: [],
    
    // ä¸»é¢˜è®¾ç½®
    theme: 'light'
  })
})
```

### 4.2 åœ¨ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€

```vue
<template>
  <div>
    <h2>æ¬¢è¿ï¼Œ{{ userStore.userInfo.name }}</h2>
    <p>ç™»å½•çŠ¶æ€ï¼š{{ userStore.isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•' }}</p>
    <p>å½“å‰ä¸»é¢˜ï¼š{{ userStore.theme }}</p>
  </div>
</template>

<script setup>
import { useUserStore } from '@/stores/user'

// è·å–ç”¨æˆ·ä»“åº“
const userStore = useUserStore()
</script>
```

### 4.3 å“åº”å¼è§£æ„

```vue
<script setup>
import { storeToRefs } from 'pinia'
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

// âœ… ä¿æŒå“åº”å¼çš„è§£æ„æ–¹å¼
const { userInfo, isLoggedIn, theme } = storeToRefs(userStore)

// âŒ ç›´æ¥è§£æ„ä¼šå¤±å»å“åº”å¼
// const { userInfo, isLoggedIn } = userStore
</script>
```

> âš ï¸ **é‡è¦æé†’**ï¼šç›´æ¥ä»storeè§£æ„ä¼šå¤±å»å“åº”å¼ï¼Œå¿…é¡»ç”¨`storeToRefs`åŒ…è£…ï¼

---

## 5. ğŸ”„ gettersè®¡ç®—çŠ¶æ€


### 5.1 åŸºæœ¬æ¦‚å¿µ

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šgetterså°±æ˜¯**åŸºäºç°æœ‰æ•°æ®è‡ªåŠ¨è®¡ç®—å‡ºæ–°æ•°æ®**ï¼Œå°±åƒExcelè¡¨æ ¼çš„å…¬å¼ï¼ŒåŸæ•°æ®å˜äº†ï¼Œè®¡ç®—ç»“æœè‡ªåŠ¨æ›´æ–°ã€‚

```javascript
// stores/cart.js
export const useCartStore = defineStore('cart', {
  state: () => ({
    items: [
      { id: 1, name: 'è‹¹æœ', price: 5, quantity: 3 },
      { id: 2, name: 'é¦™è•‰', price: 3, quantity: 2 }
    ]
  }),
  
  getters: {
    // è®¡ç®—å•†å“æ€»æ•°é‡
    totalQuantity: (state) => {
      return state.items.reduce((total, item) => total + item.quantity, 0)
    },
    
    // è®¡ç®—æ€»é‡‘é¢
    totalPrice: (state) => {
      return state.items.reduce((total, item) => total + (item.price * item.quantity), 0)
    },
    
    // è·å–æŒ‡å®šå•†å“
    getItemById: (state) => {
      return (id) => state.items.find(item => item.id === id)
    }
  }
})
```

### 5.2 ä½¿ç”¨getters

```vue
<template>
  <div class="cart-summary">
    <p>å•†å“æ€»æ•°ï¼š{{ cartStore.totalQuantity }} ä»¶</p>
    <p>æ€»é‡‘é¢ï¼šÂ¥{{ cartStore.totalPrice }}</p>
    
    <!-- ä½¿ç”¨å‚æ•°åŒ–getter -->
    <div v-if="cartStore.getItemById(1)">
      æ‰¾åˆ°å•†å“ï¼š{{ cartStore.getItemById(1).name }}
    </div>
  </div>
</template>

<script setup>
import { useCartStore } from '@/stores/cart'

const cartStore = useCartStore()
</script>
```

### 5.3 gettersä¹‹é—´çš„ä¾èµ–

```javascript
getters: {
  // åŸºç¡€è®¡ç®—
  totalPrice: (state) => {
    return state.items.reduce((total, item) => total + (item.price * item.quantity), 0)
  },
  
  // ä¾èµ–å…¶ä»–getter
  formattedPrice() {
    return `Â¥${this.totalPrice.toFixed(2)}`
  },
  
  // åˆ¤æ–­æ˜¯å¦ä¸ºå¤§é¢è®¢å•
  isLargeOrder() {
    return this.totalPrice > 100
  }
}
```

---

## 6. âš¡ actionsçŠ¶æ€ä¿®æ”¹


### 6.1 åŸºæœ¬æ¦‚å¿µ

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šactionså°±æ˜¯**ä¿®æ”¹ä»“åº“æ•°æ®çš„æ–¹æ³•**ï¼Œå°±åƒä»“åº“ç®¡ç†å‘˜çš„å·¥ä½œæ‰‹å†Œï¼Œè§„å®šäº†æ€ä¹ˆæ·»åŠ å•†å“ã€åˆ é™¤å•†å“ã€ä¿®æ”¹å•†å“ç­‰ã€‚

```javascript
// stores/cart.js
export const useCartStore = defineStore('cart', {
  state: () => ({
    items: []
  }),
  
  actions: {
    // æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
    addItem(product) {
      const existingItem = this.items.find(item => item.id === product.id)
      
      if (existingItem) {
        // å¦‚æœå•†å“å·²å­˜åœ¨ï¼Œå¢åŠ æ•°é‡
        existingItem.quantity += 1
      } else {
        // å¦‚æœæ˜¯æ–°å•†å“ï¼Œæ·»åŠ åˆ°è´­ç‰©è½¦
        this.items.push({
          id: product.id,
          name: product.name,
          price: product.price,
          quantity: 1
        })
      }
    },
    
    // åˆ é™¤å•†å“
    removeItem(productId) {
      const index = this.items.findIndex(item => item.id === productId)
      if (index > -1) {
        this.items.splice(index, 1)
      }
    },
    
    // æ¸…ç©ºè´­ç‰©è½¦
    clearCart() {
      this.items = []
    }
  }
})
```

### 6.2 å¼‚æ­¥actions

```javascript
// stores/user.js
export const useUserStore = defineStore('user', {
  state: () => ({
    userInfo: null,
    loading: false,
    error: null
  }),
  
  actions: {
    // å¼‚æ­¥ç™»å½•
    async login(credentials) {
      this.loading = true
      this.error = null
      
      try {
        // æ¨¡æ‹ŸAPIè°ƒç”¨
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(credentials)
        })
        
        const userData = await response.json()
        
        if (response.ok) {
          this.userInfo = userData
          return { success: true }
        } else {
          this.error = userData.message
          return { success: false, error: userData.message }
        }
      } catch (error) {
        this.error = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•'
        return { success: false, error: this.error }
      } finally {
        this.loading = false
      }
    }
  }
})
```

### 6.3 åœ¨ç»„ä»¶ä¸­è°ƒç”¨actions

```vue
<template>
  <div>
    <button @click="handleAddToCart">æ·»åŠ åˆ°è´­ç‰©è½¦</button>
    <button @click="handleLogin">ç™»å½•</button>
  </div>
</template>

<script setup>
import { useCartStore } from '@/stores/cart'
import { useUserStore } from '@/stores/user'

const cartStore = useCartStore()
const userStore = useUserStore()

// æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
const handleAddToCart = () => {
  const product = { id: 1, name: 'è‹¹æœ', price: 5 }
  cartStore.addItem(product)
}

// ç”¨æˆ·ç™»å½•
const handleLogin = async () => {
  const result = await userStore.login({
    username: 'admin',
    password: '123456'
  })
  
  if (result.success) {
    console.log('ç™»å½•æˆåŠŸ')
  } else {
    console.log('ç™»å½•å¤±è´¥ï¼š', result.error)
  }
}
</script>
```

---

## 7. ğŸ”„ çŠ¶æ€æ›´æ–°æŠ€å·§


### 7.1 $patchæ‰¹é‡æ›´æ–°

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šå½“éœ€è¦**ä¸€æ¬¡æ€§ä¿®æ”¹å¤šä¸ªçŠ¶æ€**æ—¶ï¼Œç”¨$patchæ¯”é€ä¸ªä¿®æ”¹æ›´é«˜æ•ˆã€‚

```javascript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const userStore = useUserStore()

// âœ… æ¨èï¼šæ‰¹é‡æ›´æ–°
userStore.$patch({
  userInfo: {
    name: 'å¼ ä¸‰',
    email: 'zhangsan@example.com'
  },
  theme: 'dark',
  isLoggedIn: true
})

// âœ… å‡½æ•°å¼æ›´æ–°ï¼ˆæ›´å¤æ‚çš„é€»è¾‘ï¼‰
userStore.$patch((state) => {
  state.userInfo.name = 'å¼ ä¸‰'
  state.permissions.push('admin')
  state.loginTime = new Date()
})
```

### 7.2 $reseté‡ç½®çŠ¶æ€

```javascript
// é‡ç½®storeåˆ°åˆå§‹çŠ¶æ€
userStore.$reset()

// ç­‰åŒäºæ‰‹åŠ¨é‡ç½®
userStore.$patch({
  userInfo: { id: null, name: '', avatar: '', email: '' },
  isLoggedIn: false,
  permissions: [],
  theme: 'light'
})
```

### 7.3 $stateæ•´ä½“æ›¿æ¢

```javascript
// å®Œå…¨æ›¿æ¢storeçŠ¶æ€ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
userStore.$state = {
  userInfo: { id: 1, name: 'æ–°ç”¨æˆ·' },
  isLoggedIn: true,
  permissions: ['read'],
  theme: 'light'
}
```

> âš ï¸ **æ³¨æ„**ï¼š`$state`ä¼šå®Œå…¨æ›¿æ¢çŠ¶æ€ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚

---

## 8. ğŸ‘‚ çŠ¶æ€è®¢é˜…ç›‘å¬


### 8.1 $subscribeè®¢é˜…å˜åŒ–

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒç»™ä»“åº“è£…äº†**ç›‘æ§æ‘„åƒå¤´**ï¼Œä»»ä½•æ•°æ®å˜åŒ–éƒ½èƒ½åŠæ—¶çŸ¥é“å¹¶åšå‡ºååº”ã€‚

```javascript
// åœ¨ç»„ä»¶ä¸­ç›‘å¬çŠ¶æ€å˜åŒ–
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

// è®¢é˜…çŠ¶æ€å˜åŒ–
userStore.$subscribe((mutation, state) => {
  console.log('çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼š', mutation)
  console.log('å˜åŒ–åçš„çŠ¶æ€ï¼š', state)
  
  // æ ¹æ®å˜åŒ–åšç›¸åº”å¤„ç†
  if (mutation.type === 'direct' && mutation.events?.key === 'theme') {
    document.body.className = state.theme
  }
})
```

### 8.2 ç›‘å¬ç‰¹å®šçŠ¶æ€

```vue
<script setup>
import { watch } from 'vue'
import { storeToRefs } from 'pinia'
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()
const { theme, isLoggedIn } = storeToRefs(userStore)

// ç›‘å¬ä¸»é¢˜å˜åŒ–
watch(theme, (newTheme) => {
  document.body.setAttribute('data-theme', newTheme)
})

// ç›‘å¬ç™»å½•çŠ¶æ€
watch(isLoggedIn, (isLoggedIn) => {
  if (isLoggedIn) {
    console.log('ç”¨æˆ·å·²ç™»å½•')
  } else {
    console.log('ç”¨æˆ·å·²é€€å‡º')
  }
})
</script>
```

### 8.3 actionsæ‰§è¡Œç›‘å¬

```javascript
// ç›‘å¬actionsçš„æ‰§è¡Œ
userStore.$onAction(({ name, args, after, onError }) => {
  console.log(`å¼€å§‹æ‰§è¡Œaction: ${name}`)
  console.log('å‚æ•°ï¼š', args)
  
  // actionæ‰§è¡Œå®Œæˆå
  after((result) => {
    console.log(`action ${name} æ‰§è¡Œå®Œæˆï¼Œç»“æœï¼š`, result)
  })
  
  // actionæ‰§è¡Œå‡ºé”™æ—¶
  onError((error) => {
    console.log(`action ${name} æ‰§è¡Œå‡ºé”™ï¼š`, error)
  })
})
```

---

## 9. ğŸ’¾ çŠ¶æ€æŒä¹…åŒ–


### 9.1 ä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–

> ğŸ’¡ **å®é™…é—®é¢˜**ï¼šç”¨æˆ·åˆ·æ–°é¡µé¢æˆ–å…³é—­æµè§ˆå™¨åï¼ŒPiniaä¸­çš„æ•°æ®å°±ä¸¢å¤±äº†ã€‚æŒä¹…åŒ–å°±æ˜¯æŠŠé‡è¦æ•°æ®**ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨**ä¸­ã€‚

```
æ²¡æœ‰æŒä¹…åŒ–ï¼š
ç”¨æˆ·ç™»å½• â†’ å…³é—­æµè§ˆå™¨ â†’ é‡æ–°æ‰“å¼€ â†’ éœ€è¦é‡æ–°ç™»å½• ğŸ˜

æœ‰äº†æŒä¹…åŒ–ï¼š
ç”¨æˆ·ç™»å½• â†’ å…³é—­æµè§ˆå™¨ â†’ é‡æ–°æ‰“å¼€ â†’ è‡ªåŠ¨æ¢å¤ç™»å½•çŠ¶æ€ ğŸ˜Š
```

### 9.2 å®‰è£…æŒä¹…åŒ–æ’ä»¶

```bash
# å®‰è£…æŒä¹…åŒ–æ’ä»¶
npm install pinia-plugin-persistedstate
```

### 9.3 é…ç½®æŒä¹…åŒ–æ’ä»¶

```javascript
// main.js
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'
import App from './App.vue'

const app = createApp(App)
const pinia = createPinia()

// ä½¿ç”¨æŒä¹…åŒ–æ’ä»¶
pinia.use(piniaPluginPersistedstate)

app.use(pinia)
app.mount('#app')
```

### 9.4 åœ¨storeä¸­å¯ç”¨æŒä¹…åŒ–

```javascript
// stores/user.js
export const useUserStore = defineStore('user', {
  state: () => ({
    userInfo: {
      id: null,
      name: '',
      avatar: ''
    },
    isLoggedIn: false,
    theme: 'light',
    cartItems: []  // ä¸éœ€è¦æŒä¹…åŒ–çš„æ•°æ®
  }),
  
  actions: {
    login(userData) {
      this.userInfo = userData
      this.isLoggedIn = true
    },
    
    logout() {
      this.userInfo = { id: null, name: '', avatar: '' }
      this.isLoggedIn = false
    }
  },
  
  // å¯ç”¨æŒä¹…åŒ–
  persist: true
})
```

### 9.5 é«˜çº§æŒä¹…åŒ–é…ç½®

```javascript
// ç²¾ç»†åŒ–æŒä¹…åŒ–é…ç½®
export const useUserStore = defineStore('user', {
  state: () => ({
    userInfo: { id: null, name: '', avatar: '' },
    isLoggedIn: false,
    theme: 'light',
    temporaryData: 'ä¸´æ—¶æ•°æ®'  // ä¸éœ€è¦æŒä¹…åŒ–
  }),
  
  persist: {
    // è‡ªå®šä¹‰å­˜å‚¨key
    key: 'my-user-store',
    
    // é€‰æ‹©å­˜å‚¨ä½ç½®
    storage: localStorage,  // æˆ– sessionStorage
    
    // åªæŒä¹…åŒ–æŒ‡å®šå­—æ®µ
    paths: ['userInfo', 'isLoggedIn', 'theme']
  }
})
```

### 9.6 å¤šç§å­˜å‚¨ç­–ç•¥

```javascript
export const useUserStore = defineStore('user', {
  state: () => ({
    userInfo: {},
    isLoggedIn: false,
    theme: 'light',
    sessionData: {}
  }),
  
  persist: [
    {
      // é•¿æœŸå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
      key: 'user-info',
      storage: localStorage,
      paths: ['userInfo', 'theme']
    },
    {
      // ä¼šè¯å­˜å‚¨ç™»å½•çŠ¶æ€
      key: 'user-session',
      storage: sessionStorage,
      paths: ['isLoggedIn', 'sessionData']
    }
  ]
})
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

```
ğŸ”¸ Piniaæœ¬è´¨ï¼šå…¨å±€æ•°æ®ä»“åº“ï¼Œè§£å†³ç»„ä»¶é—´æ•°æ®å…±äº«é—®é¢˜
ğŸ”¸ defineStoreï¼šåˆ›å»ºstoreçš„æ ¸å¿ƒæ–¹æ³•ï¼Œå®šä¹‰æ•°æ®å’Œæ“ä½œ
ğŸ”¸ stateï¼šå­˜å‚¨çŠ¶æ€æ•°æ®ï¼Œç›¸å½“äºç»„ä»¶çš„data
ğŸ”¸ gettersï¼šè®¡ç®—å±æ€§ï¼ŒåŸºäºstateè‡ªåŠ¨è®¡ç®—æ´¾ç”Ÿæ•°æ®
ğŸ”¸ actionsï¼šä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ï¼Œæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥æ“ä½œ
ğŸ”¸ æŒä¹…åŒ–ï¼šå°†é‡è¦çŠ¶æ€ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
```

### 10.2 å…³é”®ä½¿ç”¨è¦ç‚¹


**ğŸ”¹ æ•°æ®è®¿é—®åŸåˆ™**
```
âœ… ç›´æ¥è®¿é—®ï¼šuserStore.userInfo.name
âœ… å“åº”å¼è§£æ„ï¼šconst { userInfo } = storeToRefs(userStore)
âŒ ç›´æ¥è§£æ„ï¼šconst { userInfo } = userStore  // å¤±å»å“åº”å¼
```

**ğŸ”¹ çŠ¶æ€ä¿®æ”¹æ–¹å¼**
```
âœ… é€šè¿‡actionsï¼šuserStore.login(userData)
âœ… æ‰¹é‡æ›´æ–°ï¼šuserStore.$patch({ isLoggedIn: true })
âŒ ç›´æ¥ä¿®æ”¹ï¼šuserStore.isLoggedIn = true  // å¯ä»¥ä½†ä¸æ¨è
```

**ğŸ”¹ æœ€ä½³å®è·µ**
```
æ•°æ®ç»“æ„è®¾è®¡ï¼š
- æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†storeï¼ˆç”¨æˆ·ã€è´­ç‰©è½¦ã€å•†å“ç­‰ï¼‰
- stateä¿æŒæ‰å¹³åŒ–ï¼Œé¿å…è¿‡æ·±åµŒå¥—
- ä½¿ç”¨TypeScriptæä¾›ç±»å‹å®‰å…¨

æ€§èƒ½ä¼˜åŒ–ï¼š
- åˆç†ä½¿ç”¨gettersç¼“å­˜è®¡ç®—ç»“æœ
- æ‰¹é‡æ›´æ–°ä½¿ç”¨$patch
- æŒ‰éœ€æŒä¹…åŒ–ï¼Œé¿å…å­˜å‚¨è¿‡å¤šæ•°æ®
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼

- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šç™»å½•çŠ¶æ€ã€ç”¨æˆ·ä¿¡æ¯ã€æƒé™ç®¡ç†
- **è´­ç‰©è½¦**ï¼šå•†å“ç®¡ç†ã€æ•°é‡è®¡ç®—ã€ä»·æ ¼ç»Ÿè®¡
- **ä¸»é¢˜åˆ‡æ¢**ï¼šç•Œé¢ä¸»é¢˜ã€ç”¨æˆ·åå¥½è®¾ç½®
- **å…¨å±€è®¾ç½®**ï¼šè¯­è¨€åˆ‡æ¢ã€é…ç½®é¡¹ç®¡ç†

### 10.4 å­¦ä¹ è·¯å¾„å»ºè®®

```
â‘  ç†è§£æ¦‚å¿µ â†’ æ˜ç™½ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†
â‘¡ åŸºç¡€ä½¿ç”¨ â†’ æŒæ¡defineStoreåŸºæœ¬è¯­æ³•
â‘¢ æ•°æ®æ“ä½œ â†’ ç†Ÿç»ƒä½¿ç”¨stateã€gettersã€actions
â‘£ é«˜çº§ç‰¹æ€§ â†’ æŒæ¡è®¢é˜…ã€æŒä¹…åŒ–ç­‰åŠŸèƒ½
â‘¤ é¡¹ç›®å®è·µ â†’ åœ¨çœŸå®é¡¹ç›®ä¸­åº”ç”¨Pinia
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Piniaæ˜¯Vue3çš„ç°ä»£çŠ¶æ€ç®¡ç†å·¥å…·
- æ¯”Vuexæ›´ç®€å•ç›´è§‚ï¼ŒTypeScriptå‹å¥½
- ä¸‰å¤§æ ¸å¿ƒï¼šstateå­˜æ•°æ®ï¼Œgettersç®—æ•°æ®ï¼Œactionsæ”¹æ•°æ®
- æŒä¹…åŒ–è§£å†³æ•°æ®ä¸¢å¤±é—®é¢˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒ