---
title: 12ã€Redisè¿æ¥å’Œç½‘ç»œä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [è¿æ¥æ± åŸºç¡€æ¦‚å¿µ](#1-è¿æ¥æ± åŸºç¡€æ¦‚å¿µ)
2. [è¿æ¥æ± æ ¸å¿ƒé…ç½®å‚æ•°](#2-è¿æ¥æ± æ ¸å¿ƒé…ç½®å‚æ•°)
3. [è¿æ¥ç®¡ç†ä¸ä¼˜åŒ–ç­–ç•¥](#3-è¿æ¥ç®¡ç†ä¸ä¼˜åŒ–ç­–ç•¥)
4. [ç½‘ç»œå±‚ä¼˜åŒ–æŠ€æœ¯](#4-ç½‘ç»œå±‚ä¼˜åŒ–æŠ€æœ¯)
5. [å®¢æˆ·ç«¯å’Œå‘½ä»¤ä¼˜åŒ–](#5-å®¢æˆ·ç«¯å’Œå‘½ä»¤ä¼˜åŒ–)
6. [è¿æ¥æ± é…ç½®å®è·µ](#6-è¿æ¥æ± é…ç½®å®è·µ)
7. [ç”Ÿäº§ç¯å¢ƒé…ç½®](#7-ç”Ÿäº§ç¯å¢ƒé…ç½®)
8. [é—®é¢˜æ’æŸ¥ä¸è§£å†³](#8-é—®é¢˜æ’æŸ¥ä¸è§£å†³)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ è¿æ¥æ± åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è¿æ¥æ± 


**é€šä¿—ç†è§£**ï¼šè¿æ¥æ± å°±åƒåœè½¦åœºï¼Œæå‰å‡†å¤‡å¥½å¤šä¸ªåœè½¦ä½ï¼ˆè¿æ¥ï¼‰ï¼Œè½¦è¾†ï¼ˆè¯·æ±‚ï¼‰æ¥äº†ç›´æ¥åœï¼Œèµ°äº†ä½ç½®è¿˜èƒ½ç»™ä¸‹ä¸€è¾†è½¦ç”¨ã€‚

```
ä¼ ç»Ÿæ–¹å¼ - æ¯æ¬¡ä¸´æ—¶å»ºè¿æ¥ï¼š
åº”ç”¨ â†’ å»ºç«‹è¿æ¥ â†’ æ‰§è¡Œå‘½ä»¤ â†’ æ–­å¼€è¿æ¥
     â†“
   æ—¶é—´æµªè´¹  æ€§èƒ½ä½ä¸‹

è¿æ¥æ± æ–¹å¼ - å¤ç”¨è¿æ¥ï¼š
åº”ç”¨ â†’ ä»æ± ä¸­å–è¿æ¥ â†’ æ‰§è¡Œå‘½ä»¤ â†’ å½’è¿˜è¿æ¥
     â†“
   å¿«é€Ÿå“åº”  æ€§èƒ½æå‡
```

**è¿æ¥æ± çš„æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸš€ **å‡å°‘å»ºè¿å¼€é”€**ï¼šé¿å…é¢‘ç¹çš„TCPä¸‰æ¬¡æ¡æ‰‹
- ğŸ’ª **æå‡å¹¶å‘èƒ½åŠ›**ï¼šå¤šä¸ªè¿æ¥åŒæ—¶å¤„ç†è¯·æ±‚
- ğŸ›¡ï¸ **æ§åˆ¶èµ„æºä½¿ç”¨**ï¼šé™åˆ¶è¿æ¥æ•°é‡ï¼Œä¿æŠ¤RedisæœåŠ¡
- âš¡ **æé«˜å“åº”é€Ÿåº¦**ï¼šå¤ç”¨è¿æ¥ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´

### 1.2 è¿æ¥æ± vså•è¿æ¥å¯¹æ¯”


| å¯¹æ¯”ç»´åº¦ | **å•è¿æ¥æ–¹å¼** | **è¿æ¥æ± æ–¹å¼** | **å·®å¼‚è¯´æ˜** |
|---------|----------------|----------------|-------------|
| ğŸ—ï¸ **å»ºè¿å¼€é”€** | `æ¯æ¬¡éƒ½è¦å»ºè¿` | `å¤ç”¨ç°æœ‰è¿æ¥` | `è¿æ¥æ± å‡å°‘90%å»ºè¿æ—¶é—´` |
| ğŸš€ **å“åº”é€Ÿåº¦** | `æ…¢ï¼ˆå»ºè¿è€—æ—¶ï¼‰` | `å¿«ï¼ˆç›´æ¥å¯ç”¨ï¼‰` | `å“åº”æ—¶é—´å‡å°‘50-200ms` |
| ğŸ’ª **å¹¶å‘èƒ½åŠ›** | `å•çº¿ç¨‹ä¸²è¡Œ` | `å¤šè¿æ¥å¹¶è¡Œ` | `å¹¶å‘èƒ½åŠ›æå‡10å€ä»¥ä¸Š` |
| ğŸ“Š **èµ„æºæ§åˆ¶** | `æ— æ³•æ§åˆ¶` | `å¯ç²¾ç¡®æ§åˆ¶` | `é˜²æ­¢è¿æ¥æ•°è¿‡å¤šå¯¼è‡´æœåŠ¡å´©æºƒ` |
| ğŸ”§ **ç»´æŠ¤æˆæœ¬** | `ç®€å•` | `éœ€è¦è°ƒä¼˜` | `éœ€è¦åˆç†é…ç½®å‚æ•°` |

### 1.3 Redisä¸­è¿æ¥æ± çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆRedisç‰¹åˆ«éœ€è¦è¿æ¥æ± **ï¼š

```
Redisç‰¹ç‚¹ï¼š
âœ“ å•çº¿ç¨‹æ¨¡å‹ â†’ å¹¶å‘é å¤šè¿æ¥å®ç°
âœ“ å†…å­˜æ•°æ®åº“ â†’ æ“ä½œé€Ÿåº¦æå¿«ï¼Œå»ºè¿æˆä¸ºç“¶é¢ˆ
âœ“ ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿ â†’ å»ºè¿å¼€é”€ç›¸å¯¹æ›´æ˜æ˜¾

å®é™…æ•°æ®å¯¹æ¯”ï¼š
Rediså‘½ä»¤æ‰§è¡Œï¼š0.1ms
TCPå»ºè¿è€—æ—¶ï¼š1-5ms
â†’ å»ºè¿æ—¶é—´æ˜¯å‘½ä»¤æ‰§è¡Œæ—¶é—´çš„10-50å€ï¼
```

---

## 2. âš™ï¸ è¿æ¥æ± æ ¸å¿ƒé…ç½®å‚æ•°


### 2.1 æœ€å¤§è¿æ¥æ•°è®¾ç½®


#### ğŸ”¢ æœ€å¤§è¿æ¥æ•°çš„å«ä¹‰

**æœ€å¤§è¿æ¥æ•°**ï¼šè¿æ¥æ± èƒ½åŒæ—¶ç»´æŠ¤çš„Redisè¿æ¥çš„ä¸Šé™æ•°é‡

```
è®¾ç½®åŸç†ï¼š
åº”ç”¨å¹¶å‘åº¦ â‰¤ æœ€å¤§è¿æ¥æ•° â‰¤ Redisæœ€å¤§å®¢æˆ·ç«¯æ•°

è®¡ç®—å…¬å¼ï¼š
æœ€å¤§è¿æ¥æ•° = é¢„æœŸå¹¶å‘è¯·æ±‚æ•° Ã— 1.2ï¼ˆç¼“å†²ç³»æ•°ï¼‰

ç¤ºä¾‹ï¼š
å¦‚æœåº”ç”¨é¢„æœŸ100ä¸ªå¹¶å‘è¯·æ±‚
æœ€å¤§è¿æ¥æ•°è®¾ç½®ä¸º120ä¸ªæ¯”è¾ƒåˆé€‚
```

#### ğŸ“Š ä¸åŒåœºæ™¯çš„é…ç½®å»ºè®®


```bash
# Webåº”ç”¨é…ç½®ç¤ºä¾‹
å°å‹ç½‘ç«™ï¼ˆæ—¥æ´»1ä¸‡ï¼‰ï¼š
maxActive=20-50

ä¸­å‹ç½‘ç«™ï¼ˆæ—¥æ´»10ä¸‡ï¼‰ï¼š  
maxActive=50-200

å¤§å‹ç½‘ç«™ï¼ˆæ—¥æ´»100ä¸‡+ï¼‰ï¼š
maxActive=200-1000

# è€ƒè™‘å› ç´ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸šåŠ¡ç‰¹ç‚¹        â†’ è¿æ¥æ•°é…ç½®å»ºè®®    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯»å¤šå†™å°‘        â†’ è¿æ¥æ•°å¯ä»¥å¤šä¸€äº›  â”‚
â”‚ å†™å¤šè¯»å°‘        â†’ è¿æ¥æ•°é€‚ä¸­å³å¯    â”‚
â”‚ å®æ—¶æ€§è¦æ±‚é«˜    â†’ è¿æ¥æ•°å¤šä¸€äº›      â”‚
â”‚ æœåŠ¡å™¨èµ„æºæœ‰é™  â†’ è¿æ¥æ•°ä¿å®ˆä¸€äº›    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æœ€å°ç©ºé—²è¿æ¥é…ç½®


#### ğŸ’¤ ç©ºé—²è¿æ¥çš„ä½œç”¨

**æœ€å°ç©ºé—²è¿æ¥**ï¼šè¿æ¥æ± ä¸­å§‹ç»ˆä¿æŒçš„å¯ç”¨è¿æ¥æ•°é‡

```
ä½œç”¨åŸç†ï¼š
â”Œâ”€â”€â”€ è¯·æ±‚é«˜å³°æ¥ä¸´ â”€â”€â”€â”
â”‚                    â”‚
â”‚ æ— éœ€ä¸´æ—¶å»ºè¿       â”‚ â†’ ç«‹å³å“åº”
â”‚ ç›´æ¥ä½¿ç”¨ç©ºé—²è¿æ¥   â”‚
â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å»ºè®®é…ç½®ï¼š
æœ€å°ç©ºé—² = æœ€å¤§è¿æ¥æ•°çš„20-30%
ä¾‹ï¼šæœ€å¤§100ä¸ªè¿æ¥ï¼Œæœ€å°ç©ºé—²20-30ä¸ª
```

#### âš–ï¸ ç©ºé—²è¿æ¥æ•°é‡å¹³è¡¡

```
ç©ºé—²è¿æ¥å¤ªå°‘çš„é—®é¢˜ï¼š
âŒ çªå‘è¯·æ±‚æ—¶éœ€è¦ä¸´æ—¶å»ºè¿
âŒ å“åº”å»¶è¿Ÿå¢åŠ 
âŒ ç”¨æˆ·ä½“éªŒä¸‹é™

ç©ºé—²è¿æ¥å¤ªå¤šçš„é—®é¢˜ï¼š  
âŒ å ç”¨è¿‡å¤šå†…å­˜èµ„æº
âŒ å¢åŠ RedisæœåŠ¡å‹åŠ›
âŒ æµªè´¹ç³»ç»Ÿèµ„æº

æœ€ä½³å®è·µï¼š
ğŸ¯ æ ¹æ®ä¸šåŠ¡è®¿é—®æ¨¡å¼åŠ¨æ€è°ƒæ•´
ğŸ¯ ç›‘æ§è¿æ¥ä½¿ç”¨ç‡ï¼Œå®šæœŸä¼˜åŒ–
ğŸ¯ é¢„ç•™20-30%çš„ç©ºé—²è¿æ¥
```

### 2.3 è¿æ¥è¶…æ—¶è®¾ç½®è¯¦è§£


#### â° è¶…æ—¶å‚æ•°ç±»å‹

```bash
è¿æ¥è¶…æ—¶ï¼ˆConnection Timeoutï¼‰ï¼š
ä½œç”¨ï¼šå»ºç«‹è¿æ¥çš„æœ€å¤§ç­‰å¾…æ—¶é—´
å»ºè®®å€¼ï¼š1000-3000ms
é…ç½®ï¼šconnectTimeout=3000

è¯»å–è¶…æ—¶ï¼ˆRead Timeoutï¼‰ï¼š
ä½œç”¨ï¼šç­‰å¾…Rediså“åº”çš„æœ€å¤§æ—¶é—´  
å»ºè®®å€¼ï¼š2000-5000ms
é…ç½®ï¼šreadTimeout=5000

ç©ºé—²è¶…æ—¶ï¼ˆIdle Timeoutï¼‰ï¼š
ä½œç”¨ï¼šè¿æ¥ç©ºé—²å¤šä¹…åè¢«å›æ”¶
å»ºè®®å€¼ï¼š300000msï¼ˆ5åˆ†é’Ÿï¼‰
é…ç½®ï¼šidleTimeout=300000
```

#### ğŸ¯ è¶…æ—¶å‚æ•°è®¾ç½®ç­–ç•¥

```
ç½‘ç»œç¯å¢ƒå½±å“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç½‘ç»œç¯å¢ƒ    â”‚  è¿æ¥è¶…æ—¶   â”‚  è¯»å–è¶…æ—¶   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœ¬åœ°/å†…ç½‘     â”‚   1-2ç§’     â”‚   2-3ç§’     â”‚
â”‚ å…¬ç½‘/è·¨åœ°åŒº   â”‚   3-5ç§’     â”‚   5-10ç§’    â”‚
â”‚ æµ·å¤–/è·¨å›½     â”‚   5-10ç§’    â”‚   10-30ç§’   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸šåŠ¡ç±»å‹å½±å“ï¼š
å®æ—¶æ€§è¦æ±‚é«˜ â†’ è¶…æ—¶è®¾ç½®è¾ƒçŸ­ï¼ˆ1-3ç§’ï¼‰
æ‰¹å¤„ç†ä»»åŠ¡   â†’ è¶…æ—¶è®¾ç½®è¾ƒé•¿ï¼ˆ10-30ç§’ï¼‰
```

### 2.4 ç©ºé—²è¿æ¥æ£€æµ‹æœºåˆ¶


#### ğŸ” æ£€æµ‹æœºåˆ¶åŸç†

**ç©ºé—²æ£€æµ‹**ï¼šå®šæœŸæ£€æŸ¥è¿æ¥æ± ä¸­çš„è¿æ¥æ˜¯å¦è¿˜æœ‰æ•ˆ

```
æ£€æµ‹æµç¨‹ï¼š
å®šæ—¶å™¨è§¦å‘ â†’ éå†ç©ºé—²è¿æ¥ â†’ å‘é€PINGå‘½ä»¤ â†’ åˆ¤æ–­å“åº”
     â†“
   è¿æ¥æœ‰æ•ˆ â†’ ä¿ç•™      è¿æ¥å¤±æ•ˆ â†’ ç§»é™¤å¹¶é‡å»º

é…ç½®å‚æ•°ï¼š
testOnBorrow=true     # å€Ÿç”¨æ—¶æ£€æµ‹
testOnReturn=true     # å½’è¿˜æ—¶æ£€æµ‹  
testWhileIdle=true    # ç©ºé—²æ—¶æ£€æµ‹
timeBetweenEvictionRunsMillis=30000  # æ£€æµ‹é—´éš”30ç§’
```

#### âš¡ æ£€æµ‹ç­–ç•¥é…ç½®

```java
// Java Jedisè¿æ¥æ± é…ç½®ç¤ºä¾‹
JedisPoolConfig config = new JedisPoolConfig();

// ç©ºé—²è¿æ¥æ£€æµ‹é…ç½®
config.setTestWhileIdle(true);           // å¼€å¯ç©ºé—²æ£€æµ‹
config.setTimeBetweenEvictionRunsMillis(30000);  // 30ç§’æ£€æµ‹ä¸€æ¬¡
config.setNumTestsPerEvictionRun(-1);    // æ¯æ¬¡æ£€æµ‹æ‰€æœ‰ç©ºé—²è¿æ¥
config.setMinEvictableIdleTimeMillis(60000);     // ç©ºé—²60ç§’åå¯è¢«ç§»é™¤
```

**ğŸ’¡ æ£€æµ‹é¢‘ç‡å»ºè®®**ï¼š
- **é«˜é¢‘åº”ç”¨**ï¼š15-30ç§’æ£€æµ‹ä¸€æ¬¡
- **ä½é¢‘åº”ç”¨**ï¼š60-120ç§’æ£€æµ‹ä¸€æ¬¡
- **24å°æ—¶æœåŠ¡**ï¼šå¿…é¡»å¼€å¯ç©ºé—²æ£€æµ‹

---

## 3. ğŸ”„ è¿æ¥ç®¡ç†ä¸ä¼˜åŒ–ç­–ç•¥


### 3.1 é•¿è¿æ¥ä½¿ç”¨ç­–ç•¥


#### ğŸ”— ä»€ä¹ˆæ˜¯é•¿è¿æ¥

**é•¿è¿æ¥**ï¼šå»ºç«‹ä¸€æ¬¡TCPè¿æ¥åï¼ŒæŒç»­ä½¿ç”¨è¿™ä¸ªè¿æ¥è¿›è¡Œå¤šæ¬¡æ•°æ®äº¤æ¢ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ“ä½œéƒ½é‡æ–°å»ºè¿ã€‚

```
çŸ­è¿æ¥æ¨¡å¼ï¼š
è¯·æ±‚1: å»ºè¿ â†’ æ‰§è¡Œ â†’ æ–­è¿
è¯·æ±‚2: å»ºè¿ â†’ æ‰§è¡Œ â†’ æ–­è¿  
è¯·æ±‚3: å»ºè¿ â†’ æ‰§è¡Œ â†’ æ–­è¿
æ¯æ¬¡éƒ½æœ‰å»ºè¿å’Œæ–­è¿çš„å¼€é”€

é•¿è¿æ¥æ¨¡å¼ï¼š  
å»ºè¿ â†’ è¯·æ±‚1æ‰§è¡Œ â†’ è¯·æ±‚2æ‰§è¡Œ â†’ è¯·æ±‚3æ‰§è¡Œ â†’ ...
åªæœ‰ä¸€æ¬¡å»ºè¿å¼€é”€
```

#### ğŸš€ é•¿è¿æ¥çš„ä¼˜åŠ¿

```
æ€§èƒ½æå‡ï¼š
ğŸ“Š å»ºè¿æ¬¡æ•°å‡å°‘90%ä»¥ä¸Š
ğŸ“Š æ€»å“åº”æ—¶é—´å‡å°‘20-50%
ğŸ“Š æœåŠ¡å™¨è´Ÿè½½é™ä½30-40%

èµ„æºèŠ‚çº¦ï¼š
ğŸ’¾ å‡å°‘TCPçŠ¶æ€ç»´æŠ¤å¼€é”€
ğŸ’¾ é™ä½æœåŠ¡å™¨å†…å­˜æ¶ˆè€—
ğŸ’¾ å‡å°‘ç½‘ç»œå¸¦å®½ä½¿ç”¨
```

#### âš™ï¸ é•¿è¿æ¥é…ç½®è¦ç‚¹

```bash
# RedisæœåŠ¡ç«¯é…ç½®
timeout 0              # å®¢æˆ·ç«¯ç©ºé—²è¶…æ—¶ï¼ˆ0è¡¨ç¤ºä¸è¶…æ—¶ï¼‰
tcp-keepalive 300       # TCPä¿æ´»æ—¶é—´ï¼ˆç§’ï¼‰

# å®¢æˆ·ç«¯è¿æ¥æ± é…ç½®  
keepAlive=true          # å¯ç”¨é•¿è¿æ¥
soTimeout=5000          # è¯»å–è¶…æ—¶
connectionTimeout=3000  # å»ºè¿è¶…æ—¶
```

### 3.2 è¿æ¥å¤ç”¨æŠ€æœ¯


#### ğŸ”„ å¤ç”¨æœºåˆ¶åŸç†

**è¿æ¥å¤ç”¨**ï¼šåŒä¸€ä¸ªTCPè¿æ¥è¢«å¤šä¸ªä¸šåŠ¡æ“ä½œä¾æ¬¡ä½¿ç”¨

```
å¤ç”¨æµç¨‹å›¾ï¼š
çº¿ç¨‹A â†’ è·å–è¿æ¥1 â†’ æ‰§è¡Œæ“ä½œ â†’ å½’è¿˜è¿æ¥1
                                     â†“
çº¿ç¨‹B â†’ è·å–è¿æ¥1 â†’ æ‰§è¡Œæ“ä½œ â†’ å½’è¿˜è¿æ¥1
                                     â†“  
çº¿ç¨‹C â†’ è·å–è¿æ¥1 â†’ æ‰§è¡Œæ“ä½œ â†’ å½’è¿˜è¿æ¥1

å…³é”®ï¼šè¿æ¥åœ¨å½’è¿˜åç«‹å³å¯è¢«å…¶ä»–çº¿ç¨‹ä½¿ç”¨
```

#### ğŸ“ˆ å¤ç”¨æ•ˆç‡åˆ†æ

```
å¤ç”¨æ•ˆç‡è®¡ç®—ï¼š
è¿æ¥åˆ©ç”¨ç‡ = å®é™…ä½¿ç”¨æ—¶é—´ / è¿æ¥ç”Ÿå­˜æ—¶é—´

ç¤ºä¾‹ï¼š
è¿æ¥ç”Ÿå­˜10åˆ†é’Ÿï¼Œå®é™…æ‰§è¡Œå‘½ä»¤2åˆ†é’Ÿ
è¿æ¥åˆ©ç”¨ç‡ = 2åˆ†é’Ÿ / 10åˆ†é’Ÿ = 20%

ä¼˜åŒ–ç›®æ ‡ï¼š
æé«˜è¿æ¥åˆ©ç”¨ç‡åˆ°60-80%
åˆç†è®¾ç½®è¿æ¥æ•°é‡å’Œè¶…æ—¶æ—¶é—´
```

### 3.3 å¿ƒè·³æœºåˆ¶å’Œä¿æ´»


#### ğŸ’— å¿ƒè·³æœºåˆ¶åŸç†

**å¿ƒè·³æ£€æµ‹**ï¼šå®šæœŸå‘é€PINGå‘½ä»¤æ£€æŸ¥è¿æ¥æ˜¯å¦è¿˜æ´»ç€

```
å¿ƒè·³æ£€æµ‹æµç¨‹ï¼š
å®šæ—¶å™¨è§¦å‘ â†’ å‘é€PING â†’ ç­‰å¾…PONG â†’ åˆ¤æ–­è¿æ¥çŠ¶æ€
     â†“
  æ”¶åˆ°PONG â†’ è¿æ¥æ­£å¸¸    è¶…æ—¶æ— å“åº” â†’ è¿æ¥å¤±æ•ˆï¼Œé‡å»º

é…ç½®ç¤ºä¾‹ï¼š
heartbeatInterval=30000   # 30ç§’å‘ä¸€æ¬¡å¿ƒè·³
heartbeatTimeout=5000     # 5ç§’å†…æ— å“åº”è®¤ä¸ºå¤±æ•ˆ
```

#### ğŸ”§ ä¿æ´»æœºåˆ¶é…ç½®

```bash
# RedisæœåŠ¡ç«¯TCPä¿æ´»é…ç½®
tcp-keepalive 300
# å«ä¹‰ï¼š300ç§’æ— æ•°æ®ä¼ è¾“æ—¶å‘é€TCPä¿æ´»æ¢æµ‹åŒ…

# Linuxç³»ç»ŸTCPä¿æ´»å‚æ•°ï¼ˆå½±å“Redisï¼‰
net.ipv4.tcp_keepalive_time = 7200     # 7200ç§’å¼€å§‹å‘ä¿æ´»åŒ…
net.ipv4.tcp_keepalive_intvl = 75      # æ¢æµ‹é—´éš”75ç§’  
net.ipv4.tcp_keepalive_probes = 9      # æ¢æµ‹9æ¬¡å¤±è´¥åè®¤ä¸ºè¿æ¥æ–­å¼€

# å®¢æˆ·ç«¯ä¿æ´»é…ç½®
socket.setKeepAlive(true);             # å¯ç”¨TCPä¿æ´»
```

**ğŸ’¡ ä¿æ´»æœºåˆ¶çš„é‡è¦æ€§**ï¼š
- åŠæ—¶å‘ç°ç½‘ç»œä¸­æ–­
- æ¸…ç†åƒµæ­»è¿æ¥
- é˜²æ­¢é˜²ç«å¢™è¶…æ—¶æ–­è¿
- æé«˜ç³»ç»Ÿç¨³å®šæ€§

---

## 4. ğŸŒ ç½‘ç»œå±‚ä¼˜åŒ–æŠ€æœ¯


### 4.1 TCP_NODELAYå‚æ•°è¯¦è§£


#### ğŸ”§ TCP_NODELAYçš„å«ä¹‰

**Nagleç®—æ³•**ï¼šTCPé»˜è®¤ä¼šç­‰å¾…æ›´å¤šæ•°æ®ä¸€èµ·å‘é€ï¼Œå‡å°‘ç½‘ç»œåŒ…æ•°é‡ï¼Œä½†ä¼šå¢åŠ å»¶è¿Ÿã€‚

```
Nagleç®—æ³•æ•ˆæœï¼š
å‘é€"GET key1" â†’ ç­‰å¾…40msçœ‹æœ‰æ²¡æœ‰æ›´å¤šæ•°æ® â†’ æ²¡æœ‰åˆ™å‘é€
ç»“æœï¼šèŠ‚çœç½‘ç»œå¸¦å®½ï¼Œä½†å¢åŠ äº†40mså»¶è¿Ÿ

TCP_NODELAYæ•ˆæœï¼š
å‘é€"GET key1" â†’ ç«‹å³å‘é€ï¼Œä¸ç­‰å¾…
ç»“æœï¼šå“åº”æ›´å¿«ï¼Œä½†å¯èƒ½å¢åŠ ç½‘ç»œåŒ…æ•°é‡
```

#### âš¡ TCP_NODELAYé…ç½®

```java
// Javaå®¢æˆ·ç«¯é…ç½®
Socket socket = new Socket();
socket.setTcpNoDelay(true);  // å…³é—­Nagleç®—æ³•

// æˆ–åœ¨è¿æ¥æ± ä¸­é…ç½®
JedisPool pool = new JedisPool(config, host, port);
// Jedisé»˜è®¤å·²å¯ç”¨TCP_NODELAY
```

**ğŸ¯ ä½¿ç”¨å»ºè®®**ï¼š
- âœ… **Redisåœºæ™¯å»ºè®®å¯ç”¨**ï¼šå› ä¸ºRedisæ“ä½œé€šå¸¸æ˜¯å°æ•°æ®å¿«é€Ÿäº¤äº’
- âœ… **å®æ—¶æ€§è¦æ±‚é«˜å¯ç”¨**ï¼šå¦‚å®æ—¶èŠå¤©ã€æ¸¸æˆ
- âŒ **å¤§æ–‡ä»¶ä¼ è¾“å¯ç¦ç”¨**ï¼šå¦‚æ–‡ä»¶ä¸Šä¼ ä¸‹è½½

### 4.2 Pipelineæ‰¹é‡æ“ä½œ


#### ğŸš„ PipelineåŸç†è¯¦è§£

**Pipeline**ï¼šå°†å¤šä¸ªRediså‘½ä»¤æ‰“åŒ…ä¸€æ¬¡æ€§å‘é€ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆ3æ¬¡ç½‘ç»œå¾€è¿”ï¼‰ï¼š
å®¢æˆ·ç«¯                    RedisæœåŠ¡å™¨
  |                           |
  |------- SET key1 --------> |
  |<------ OK --------------- |
  |------- SET key2 --------> |  
  |<------ OK --------------- |
  |------- GET key1 --------> |
  |<------ value ------------ |

Pipelineæ–¹å¼ï¼ˆ1æ¬¡ç½‘ç»œå¾€è¿”ï¼‰ï¼š
å®¢æˆ·ç«¯                    RedisæœåŠ¡å™¨  
  |                           |
  |-- SET key1;SET key2;GET key1 ->|
  |<-- OK;OK;value ----------|

æ€§èƒ½æå‡ï¼šç½‘ç»œå»¶è¿Ÿä» 3Ã—RTT é™åˆ° 1Ã—RTT
```

#### ğŸ’» Pipelineä»£ç å®ç°

```java
// Java Jedis Pipelineç¤ºä¾‹
try (Jedis jedis = pool.getResource()) {
    Pipeline pipeline = jedis.pipelined();
    
    // æ‰¹é‡æ“ä½œ
    pipeline.set("user:1", "John");
    pipeline.set("user:2", "Jane");  
    pipeline.incr("counter");
    pipeline.get("user:1");
    
    // ä¸€æ¬¡æ€§æ‰§è¡Œå¹¶è·å–ç»“æœ
    List<Object> results = pipeline.syncAndReturnAll();
    
    // å¤„ç†ç»“æœ
    String user1 = (String) results.get(3);  // GET user:1çš„ç»“æœ
}
```

```python
# Python redis-py Pipelineç¤ºä¾‹
import redis

r = redis.Redis(host='localhost', port=6379, db=0)
pipe = r.pipeline()

# æ‰¹é‡æ“ä½œ
pipe.set('user:1', 'John')
pipe.set('user:2', 'Jane')
pipe.incr('counter')
pipe.get('user:1')

# æ‰§è¡Œå¹¶è·å–ç»“æœ
results = pipe.execute()
print(results)  # ['OK', 'OK', 1, b'John']
```

#### ğŸ“Š Pipelineæ€§èƒ½å¯¹æ¯”

```
æµ‹è¯•åœºæ™¯ï¼šæ‰§è¡Œ1000æ¬¡SETæ“ä½œ
ç½‘ç»œå»¶è¿Ÿï¼š1ms

æ™®é€šæ–¹å¼ï¼š
1000æ¬¡æ“ä½œ Ã— 2msï¼ˆå¾€è¿”ï¼‰ = 2000ms

Pipelineæ–¹å¼ï¼š
1æ¬¡ç½‘ç»œå¾€è¿” = 2ms
æ€§èƒ½æå‡ï¼š99.9%

å®é™…æµ‹è¯•æ•°æ®ï¼š
æ“ä½œæ•°é‡     æ™®é€šæ–¹å¼      Pipelineæ–¹å¼    æ€§èƒ½æå‡
100æ¬¡        200ms        5ms           40å€  
1000æ¬¡       2000ms       20ms          100å€
10000æ¬¡      20ç§’         200ms         100å€
```

### 4.3 æœ¬åœ°åŒ–éƒ¨ç½²ä¼˜åŒ–


#### ğŸ  æœ¬åœ°åŒ–éƒ¨ç½²çš„å«ä¹‰

**æœ¬åœ°åŒ–éƒ¨ç½²**ï¼šå°†RedisæœåŠ¡å™¨éƒ¨ç½²åœ¨è·ç¦»åº”ç”¨æœåŠ¡å™¨æœ€è¿‘çš„ä½ç½®

```
ç½‘ç»œå»¶è¿Ÿå¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   éƒ¨ç½²æ–¹å¼     â”‚  ç½‘ç»œå»¶è¿Ÿ  â”‚   é€‚ç”¨åœºæ™¯   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŒæœºæˆ¿å†…ç½‘     â”‚   <1ms     â”‚  é«˜æ€§èƒ½åº”ç”¨  â”‚
â”‚ åŒåŸä¸åŒæœºæˆ¿   â”‚   2-5ms    â”‚  ä¸€èˆ¬åº”ç”¨    â”‚
â”‚ è·¨åŸå¸‚éƒ¨ç½²     â”‚   10-50ms  â”‚  åˆ†å¸ƒå¼ç³»ç»Ÿ  â”‚
â”‚ è·¨å›½éƒ¨ç½²       â”‚   100ms+   â”‚  å…¨çƒåŒ–åº”ç”¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ¯ æœ¬åœ°åŒ–éƒ¨ç½²ç­–ç•¥

```
éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©ï¼š

æ–¹æ¡ˆ1ï¼šRedisä¸åº”ç”¨åŒæœºéƒ¨ç½²
ä¼˜åŠ¿ï¼šå»¶è¿Ÿæœ€ä½ï¼ˆ<0.1msï¼‰
ç¼ºé™·ï¼šèµ„æºç«äº‰ï¼Œå•ç‚¹æ•…éšœé£é™©
é€‚ç”¨ï¼šå°å‹åº”ç”¨ï¼Œæ€§èƒ½è¦æ±‚æé«˜

æ–¹æ¡ˆ2ï¼šRedisç‹¬ç«‹æœåŠ¡å™¨å†…ç½‘éƒ¨ç½²  
ä¼˜åŠ¿ï¼šæ€§èƒ½ç¨³å®šï¼Œæ˜“äºç®¡ç†
ç¼ºé™·ï¼šéœ€è¦é¢å¤–æœåŠ¡å™¨æˆæœ¬
é€‚ç”¨ï¼šä¸­å¤§å‹åº”ç”¨ï¼ˆæ¨èï¼‰

æ–¹æ¡ˆ3ï¼šRedisé›†ç¾¤å¤šæœºæˆ¿éƒ¨ç½²
ä¼˜åŠ¿ï¼šé«˜å¯ç”¨ï¼Œå®¹ç¾èƒ½åŠ›å¼º
ç¼ºé™·ï¼šå¤æ‚åº¦é«˜ï¼Œæˆæœ¬é«˜
é€‚ç”¨ï¼šå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ
```

#### ğŸŒ åœ°åŸŸåˆ†å¸ƒä¼˜åŒ–

```
CDN + Redisç»„åˆï¼š
ç”¨æˆ·è¯·æ±‚ â†’ å°±è¿‘CDNèŠ‚ç‚¹ â†’ å°±è¿‘Redisç¼“å­˜ â†’ åç«¯æœåŠ¡

å¤šçº§ç¼“å­˜æ¶æ„ï¼š
æµè§ˆå™¨ç¼“å­˜ â†’ CDNç¼“å­˜ â†’ æœ¬åœ°Redis â†’ è¿œç¨‹Redis â†’ æ•°æ®åº“
      â†“
    é€å±‚è¿‡æ»¤ï¼Œå‡å°‘è¿œç¨‹è®¿é—®
```

---

## 5. ğŸ¯ å®¢æˆ·ç«¯å’Œå‘½ä»¤ä¼˜åŒ–


### 5.1 å®¢æˆ·ç«¯è¿æ¥æ± é…ç½®è¯¦è§£


#### ğŸ“ å®Œæ•´é…ç½®æ¨¡æ¿

```java
// Java Jedisè¿æ¥æ± å®Œæ•´é…ç½®
public class RedisConfig {
    
    @Bean
    public JedisPool jedisPool() {
        JedisPoolConfig config = new JedisPoolConfig();
        
        // === è¿æ¥æ•°é…ç½® ===
        config.setMaxTotal(200);           // æœ€å¤§è¿æ¥æ•°
        config.setMaxIdle(50);             // æœ€å¤§ç©ºé—²è¿æ¥
        config.setMinIdle(10);             // æœ€å°ç©ºé—²è¿æ¥
        
        // === è¶…æ—¶é…ç½® ===
        config.setMaxWaitMillis(3000);     // è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´
        
        // === æ£€æµ‹é…ç½® ===
        config.setTestOnBorrow(true);      // å€Ÿç”¨æ—¶æ£€æµ‹
        config.setTestOnReturn(true);      // å½’è¿˜æ—¶æ£€æµ‹
        config.setTestWhileIdle(true);     // ç©ºé—²æ—¶æ£€æµ‹
        
        // === ç©ºé—²è¿æ¥æ¸…ç† ===
        config.setTimeBetweenEvictionRunsMillis(30000);  // 30ç§’æ£€æµ‹ä¸€æ¬¡
        config.setMinEvictableIdleTimeMillis(300000);    // 5åˆ†é’Ÿç©ºé—²å¯æ¸…ç†
        
        // åˆ›å»ºè¿æ¥æ± 
        return new JedisPool(config, "localhost", 6379, 5000, "password");
    }
}
```

#### ğŸ›ï¸ å‚æ•°è°ƒä¼˜æŒ‡å—

```
ä¸åŒåº”ç”¨ç±»å‹çš„å‚æ•°å»ºè®®ï¼š

Webåº”ç”¨ï¼ˆQPS < 1000ï¼‰ï¼š
maxTotal=50, maxIdle=20, minIdle=5

ä¸­ç­‰è´Ÿè½½åº”ç”¨ï¼ˆQPS 1000-5000ï¼‰ï¼š
maxTotal=200, maxIdle=50, minIdle=20

é«˜è´Ÿè½½åº”ç”¨ï¼ˆQPS > 5000ï¼‰ï¼š
maxTotal=500, maxIdle=100, minIdle=50

å®æ—¶ç³»ç»Ÿï¼š
maxWaitMillis=1000     # å¿«é€Ÿå¤±è´¥
testOnBorrow=true      # ç¡®ä¿è¿æ¥å¯ç”¨

æ‰¹å¤„ç†ç³»ç»Ÿï¼š
maxWaitMillis=10000    # å…è®¸æ›´é•¿ç­‰å¾…
testWhileIdle=true     # åå°æ¸…ç†æ— æ•ˆè¿æ¥
```

### 5.2 å®¢æˆ·ç«¯ä¼˜åŒ–æŠ€å·§


#### ğŸ”§ è¿æ¥è·å–ä¼˜åŒ–

```java
// ä¼˜åŒ–çš„è¿æ¥ä½¿ç”¨æ¨¡å¼
public class RedisService {
    
    // âœ… æ¨èï¼šä½¿ç”¨try-with-resourcesè‡ªåŠ¨ç®¡ç†è¿æ¥
    public String get(String key) {
        try (Jedis jedis = pool.getResource()) {
            return jedis.get(key);
        }
    }
    
    // âŒ é¿å…ï¼šæ‰‹åŠ¨ç®¡ç†è¿æ¥ï¼ˆå®¹æ˜“å¿˜è®°å½’è¿˜ï¼‰
    public String getBad(String key) {
        Jedis jedis = pool.getResource();
        String value = jedis.get(key);
        // å¿˜è®°å½’è¿˜è¿æ¥ï¼
        return value;
    }
    
    // âœ… æ¨èï¼šæ‰¹é‡æ“ä½œä½¿ç”¨Pipeline
    public void batchSet(Map<String, String> data) {
        try (Jedis jedis = pool.getResource()) {
            Pipeline pipeline = jedis.pipelined();
            for (Map.Entry<String, String> entry : data.entrySet()) {
                pipeline.set(entry.getKey(), entry.getValue());
            }
            pipeline.sync();  // æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
        }
    }
}
```

#### ğŸ¯ è¿æ¥ä½¿ç”¨æœ€ä½³å®è·µ

```
è¿æ¥ä½¿ç”¨åŸåˆ™ï¼š
ğŸ”¸ å¿«å–å¿«è¿˜ï¼šè·å–è¿æ¥åå°½å¿«æ‰§è¡Œå¹¶å½’è¿˜
ğŸ”¸ å¼‚å¸¸å®‰å…¨ï¼šæ— è®ºæ˜¯å¦å¼‚å¸¸éƒ½è¦å½’è¿˜è¿æ¥  
ğŸ”¸ æ‰¹é‡ä¼˜åŒ–ï¼šå¤šä¸ªæ“ä½œå°½é‡ä½¿ç”¨Pipeline
ğŸ”¸ é¿å…é•¿æ—¶é—´å ç”¨ï¼šä¸è¦åœ¨è¿æ¥ä¸Šåšè€—æ—¶æ“ä½œ

é”™è¯¯ä½¿ç”¨æ¨¡å¼ï¼š
âŒ é•¿æ—¶é—´æŒæœ‰è¿æ¥
âŒ åœ¨äº‹åŠ¡ä¸­ç¡çœ 
âŒ å¿˜è®°å½’è¿˜è¿æ¥
âŒ å¼‚å¸¸æ—¶ä¸é‡Šæ”¾è¿æ¥
```

### 5.3 å‘½ä»¤ä¼˜åŒ–ç­–ç•¥


#### âš ï¸ å±é™©å‘½ä»¤é¿å…

```bash
# å±é™©å‘½ä»¤åŠå…¶å½±å“
FLUSHALL        # æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“ â†’ æ•°æ®å…¨éƒ¨ä¸¢å¤±
FLUSHDB         # æ¸…ç©ºå½“å‰æ•°æ®åº“ â†’ å½“å‰åº“æ•°æ®ä¸¢å¤±  
KEYS *          # æ‰«ææ‰€æœ‰key â†’ é˜»å¡RedisæœåŠ¡
CONFIG SET      # ä¿®æ”¹é…ç½® â†’ å¯èƒ½å¯¼è‡´æœåŠ¡ä¸ç¨³å®š
SHUTDOWN        # å…³é—­æœåŠ¡ â†’ æœåŠ¡ä¸­æ–­

# å®‰å…¨æ›¿ä»£æ–¹æ¡ˆ
æ›¿ä»£KEYSï¼šä½¿ç”¨SCANåˆ†æ‰¹æ‰«æ
SCAN 0 MATCH pattern* COUNT 100

æ›¿ä»£FLUSHALLï¼šé€ä¸ªåˆ é™¤æˆ–é‡å¯æœåŠ¡
DEL key1 key2 key3

é…ç½®ç¦ç”¨ï¼šåœ¨redis.confä¸­é‡å‘½å
rename-command FLUSHALL ""
rename-command FLUSHDB ""
rename-command KEYS ""
```

#### ğŸš€ æ‰¹é‡æ“ä½œä¼˜åŒ–

```java
// âŒ ä½æ•ˆï¼šå¾ªç¯å•ä¸ªæ“ä½œ
public void setUsers(List<User> users) {
    try (Jedis jedis = pool.getResource()) {
        for (User user : users) {
            jedis.set("user:" + user.getId(), user.getName());
            // æ¯æ¬¡æ“ä½œéƒ½æœ‰ç½‘ç»œå¾€è¿”å¼€é”€
        }
    }
}

// âœ… é«˜æ•ˆï¼šPipelineæ‰¹é‡æ“ä½œ  
public void setUsersOptimized(List<User> users) {
    try (Jedis jedis = pool.getResource()) {
        Pipeline pipeline = jedis.pipelined();
        for (User user : users) {
            pipeline.set("user:" + user.getId(), user.getName());
        }
        pipeline.sync();  // ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
    }
}

// âœ… æ›´é«˜æ•ˆï¼šMSETæ‰¹é‡è®¾ç½®
public void setUsersMost(Map<String, String> userData) {
    try (Jedis jedis = pool.getResource()) {
        jedis.mset(userData);  // åŸå­æ€§æ‰¹é‡è®¾ç½®
    }
}
```

#### âš›ï¸ åŸå­æ“ä½œè®¾è®¡

```java
// åŸå­æ“ä½œçš„é‡è¦æ€§
public boolean transferPoints(String fromUser, String toUser, int points) {
    try (Jedis jedis = pool.getResource()) {
        // âŒ éåŸå­æ“ä½œï¼ˆå¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´ï¼‰
        int fromPoints = Integer.parseInt(jedis.get("points:" + fromUser));
        int toPoints = Integer.parseInt(jedis.get("points:" + toUser));
        
        jedis.set("points:" + fromUser, String.valueOf(fromPoints - points));
        // å¦‚æœè¿™é‡Œå‡ºç°å¼‚å¸¸ï¼Œæ•°æ®å°±ä¸ä¸€è‡´äº†ï¼
        jedis.set("points:" + toUser, String.valueOf(toPoints + points));
        
        return true;
    }
}

// âœ… ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§
public boolean transferPointsAtomic(String fromUser, String toUser, int points) {
    String luaScript = 
        "local from_points = redis.call('GET', KEYS[1]) " +
        "local to_points = redis.call('GET', KEYS[2]) " +
        "if from_points >= ARGV[1] then " +
        "  redis.call('DECRBY', KEYS[1], ARGV[1]) " +
        "  redis.call('INCRBY', KEYS[2], ARGV[1]) " +
        "  return 1 " +
        "else " +
        "  return 0 " +
        "end";
    
    try (Jedis jedis = pool.getResource()) {
        Object result = jedis.eval(luaScript, 
                                 Arrays.asList("points:" + fromUser, "points:" + toUser),
                                 Arrays.asList(String.valueOf(points)));
        return "1".equals(result.toString());
    }
}
```

---

## 6. ğŸ”§ è¿æ¥æ± é…ç½®å®è·µ


### 6.1 è¿æ¥æ± å‚æ•°è®¾ç½®è¯¦è§£


#### ğŸ“Š å‚æ•°è®¾ç½®è®¡ç®—æ–¹æ³•

```
è¿æ¥æ± å‚æ•°è®¡ç®—å…¬å¼ï¼š

æœ€å¤§è¿æ¥æ•°è®¡ç®—ï¼š
maxTotal = å¹¶å‘ç”¨æˆ·æ•° Ã— æ¯ç”¨æˆ·å¹³å‡è¿æ¥æ•° Ã— å®‰å…¨ç³»æ•°(1.2-1.5)

æœ€å¤§ç©ºé—²è¿æ¥è®¡ç®—ï¼š
maxIdle = maxTotal Ã— 0.6-0.8

æœ€å°ç©ºé—²è¿æ¥è®¡ç®—ï¼š  
minIdle = maxTotal Ã— 0.2-0.3

ç¤ºä¾‹è®¡ç®—ï¼š
é¢„æœŸå¹¶å‘1000ï¼Œæ¯ç”¨æˆ·1ä¸ªè¿æ¥ï¼Œå®‰å…¨ç³»æ•°1.3
maxTotal = 1000 Ã— 1 Ã— 1.3 = 1300
maxIdle = 1300 Ã— 0.7 = 910
minIdle = 1300 Ã— 0.25 = 325
```

#### ğŸ›ï¸ åŠ¨æ€è°ƒä¼˜ç­–ç•¥

```java
// è¿æ¥æ± çŠ¶æ€ç›‘æ§
public class PoolMonitor {
    
    public void printPoolStats(JedisPool pool) {
        JedisPoolConfig config = pool.getPoolConfig();
        
        System.out.println("=== è¿æ¥æ± çŠ¶æ€ ===");
        System.out.println("æ´»è·ƒè¿æ¥æ•°: " + pool.getNumActive());
        System.out.println("ç©ºé—²è¿æ¥æ•°: " + pool.getNumIdle());
        System.out.println("ç­‰å¾…è¿æ¥æ•°: " + pool.getNumWaiters());
        
        // æ ¹æ®ç›‘æ§æ•°æ®è°ƒä¼˜
        if (pool.getNumWaiters() > 0) {
            System.out.println("âš ï¸ è­¦å‘Šï¼šæœ‰çº¿ç¨‹åœ¨ç­‰å¾…è¿æ¥ï¼Œè€ƒè™‘å¢åŠ maxTotal");
        }
        
        if (pool.getNumIdle() > config.getMaxTotal() * 0.8) {
            System.out.println("ğŸ’¡ å»ºè®®ï¼šç©ºé—²è¿æ¥è¿‡å¤šï¼Œå¯ä»¥å‡å°‘maxIdle");
        }
    }
}
```

### 6.2 è¿æ¥æ± ç›‘æ§æŒ‡æ ‡


#### ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡

```
æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼š

è¿æ¥æ•°æŒ‡æ ‡ï¼š
ğŸ“Š æ´»è·ƒè¿æ¥æ•°ï¼ˆNumActiveï¼‰ï¼šæ­£åœ¨ä½¿ç”¨çš„è¿æ¥
ğŸ“Š ç©ºé—²è¿æ¥æ•°ï¼ˆNumIdleï¼‰ï¼šæ± ä¸­å¯ç”¨çš„ç©ºé—²è¿æ¥  
ğŸ“Š ç­‰å¾…è¿æ¥æ•°ï¼ˆNumWaitersï¼‰ï¼šç­‰å¾…è·å–è¿æ¥çš„çº¿ç¨‹

æ€§èƒ½æŒ‡æ ‡ï¼š
â±ï¸ å¹³å‡è·å–è¿æ¥æ—¶é—´ï¼šåæ˜ è¿æ¥æ± å‹åŠ›
â±ï¸ æœ€å¤§è·å–è¿æ¥æ—¶é—´ï¼šæ£€æµ‹æ˜¯å¦æœ‰è¶…æ—¶
ğŸ“Š è¿æ¥è·å–æˆåŠŸç‡ï¼šè¿æ¥æ± å¥åº·åº¦æŒ‡æ ‡

èµ„æºä½¿ç”¨ç‡ï¼š
ğŸ’¾ è¿æ¥æ± ä½¿ç”¨ç‡ = æ´»è·ƒè¿æ¥æ•° / æœ€å¤§è¿æ¥æ•°
ğŸ’¤ ç©ºé—²è¿æ¥ç‡ = ç©ºé—²è¿æ¥æ•° / æœ€å¤§è¿æ¥æ•°
```

#### ğŸš¨ å‘Šè­¦é˜ˆå€¼è®¾ç½®

```bash
# ç›‘æ§å‘Šè­¦é˜ˆå€¼å»ºè®®
è¿æ¥æ± ä½¿ç”¨ç‡ > 80%    â†’ é»„è‰²è­¦å‘Šï¼ˆè€ƒè™‘æ‰©å®¹ï¼‰
è¿æ¥æ± ä½¿ç”¨ç‡ > 95%    â†’ çº¢è‰²å‘Šè­¦ï¼ˆç«‹å³æ‰©å®¹ï¼‰
ç­‰å¾…è¿æ¥æ•° > 0        â†’ æ©™è‰²è­¦å‘Šï¼ˆè¿æ¥ä¸è¶³ï¼‰
è·å–è¿æ¥æ—¶é—´ > 1000ms â†’ çº¢è‰²å‘Šè­¦ï¼ˆæ€§èƒ½é—®é¢˜ï¼‰

# å‘Šè­¦è„šæœ¬ç¤ºä¾‹
#!/bin/bash
ACTIVE_CONN=$(redis-cli info clients | grep connected_clients | cut -d: -f2)
MAX_CONN=$(redis-cli config get maxclients | tail -1)

USAGE=$(echo "scale=2; $ACTIVE_CONN * 100 / $MAX_CONN" | bc)

if [ $(echo "$USAGE > 80" | bc) -eq 1 ]; then
    echo "âš ï¸ Redisè¿æ¥ä½¿ç”¨ç‡å‘Šè­¦: ${USAGE}%"
fi
```

---

## 7. ğŸ­ ç”Ÿäº§ç¯å¢ƒé…ç½®


### 7.1 ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿


#### ğŸ“‹ æ ‡å‡†é…ç½®æ¨¡æ¿

```bash
# ===== Redisç”Ÿäº§ç¯å¢ƒæ ‡å‡†é…ç½® =====

# ç½‘ç»œé…ç½®
bind 10.0.1.100 127.0.0.1    # å†…ç½‘IP + æœ¬æœºIP
port 6379
tcp-backlog 511
timeout 300                   # 5åˆ†é’Ÿå®¢æˆ·ç«¯è¶…æ—¶
tcp-keepalive 60              # 60ç§’TCPä¿æ´»

# å†…å­˜é…ç½®  
maxmemory 8gb                 # æ ¹æ®æœåŠ¡å™¨å†…å­˜è®¾ç½®
maxmemory-policy allkeys-lru  # LRUæ·˜æ±°ç­–ç•¥

# å®‰å…¨é…ç½®
requirepass your_production_password_here
protected-mode yes

# æŒä¹…åŒ–é…ç½®
save 900 1                    # 900ç§’å†…æœ‰1ä¸ªkeyå˜åŒ–å°±ä¿å­˜
save 300 10                   # 300ç§’å†…æœ‰10ä¸ªkeyå˜åŒ–å°±ä¿å­˜  
save 60 10000                 # 60ç§’å†…æœ‰10000ä¸ªkeyå˜åŒ–å°±ä¿å­˜

# æ—¥å¿—é…ç½®
loglevel notice
logfile /var/log/redis/redis-server.log

# å®¢æˆ·ç«¯é…ç½®
maxclients 10000              # æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°

# æ…¢æŸ¥è¯¢é…ç½®  
slowlog-log-slower-than 10000 # è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡10msçš„å‘½ä»¤
slowlog-max-len 128           # æœ€å¤šè®°å½•128æ¡æ…¢æŸ¥è¯¢
```

#### ğŸ”’ å®‰å…¨å¢å¼ºé…ç½®

```bash
# é«˜çº§å®‰å…¨é…ç½®
rename-command FLUSHDB ""           # ç¦ç”¨FLUSHDB
rename-command FLUSHALL ""          # ç¦ç”¨FLUSHALL  
rename-command CONFIG "CONFIG_9f2d8a0b"  # é‡å‘½åCONFIGå‘½ä»¤
rename-command DEBUG ""             # ç¦ç”¨DEBUG
rename-command EVAL ""              # ç¦ç”¨EVALï¼ˆå¯é€‰ï¼‰

# ç½‘ç»œå®‰å…¨
protected-mode yes
bind 10.0.1.100                    # åªç»‘å®šå†…ç½‘IP

# ç”¨æˆ·æƒé™ç®¡ç†ï¼ˆRedis 6.0+ï¼‰
user app_user on >app_password ~cache:* +@read +@write -@dangerous
user readonly_user on >readonly_pass ~* +@read -@write -@dangerous
```

### 7.2 é…ç½®å˜æ›´æœ€ä½³å®è·µ


#### ğŸ“ å®‰å…¨é…ç½®æ›´æ–°æµç¨‹

```
é…ç½®å˜æ›´æ ‡å‡†æµç¨‹ï¼š

ç¬¬1æ­¥ï¼šå¤‡ä»½å½“å‰é…ç½®
cp /etc/redis/redis.conf /etc/redis/redis.conf.backup.$(date +%Y%m%d_%H%M%S)

ç¬¬2æ­¥ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®
redis-server /tmp/test-redis.conf --port 6380

ç¬¬3æ­¥ï¼šæ£€æŸ¥é…ç½®è¯­æ³•
redis-server /etc/redis/redis.conf --test-memory

ç¬¬4æ­¥ï¼šç”Ÿäº§ç¯å¢ƒåº”ç”¨é…ç½®
# é‡æ–°åŠ è½½é…ç½®ï¼ˆéƒ¨åˆ†å‚æ•°æ”¯æŒï¼‰
redis-cli CONFIG REWRITE

# æˆ–é‡å¯æœåŠ¡ï¼ˆå…¨éƒ¨é…ç½®ç”Ÿæ•ˆï¼‰
sudo systemctl restart redis-server

ç¬¬5æ­¥ï¼šéªŒè¯é…ç½®ç”Ÿæ•ˆ
redis-cli CONFIG GET "*" | grep ä¿®æ”¹çš„å‚æ•°å
```

#### âš¡ çƒ­æ›´æ–°vsé‡å¯

```
æ”¯æŒçƒ­æ›´æ–°çš„é…ç½®ï¼š
âœ… maxmemory          # å†…å­˜é™åˆ¶
âœ… maxmemory-policy   # æ·˜æ±°ç­–ç•¥
âœ… slowlogé…ç½®        # æ…¢æŸ¥è¯¢è®¾ç½®
âœ… éƒ¨åˆ†å®‰å…¨é…ç½®       # å¦‚é‡å‘½åå‘½ä»¤

éœ€è¦é‡å¯çš„é…ç½®ï¼š
ğŸ”„ bind               # IPç»‘å®š
ğŸ”„ port               # ç«¯å£
ğŸ”„ daemonize          # åå°è¿è¡Œ
ğŸ”„ æŒä¹…åŒ–é…ç½®         # saveã€AOFé…ç½®

çƒ­æ›´æ–°å‘½ä»¤ï¼š
redis-cli CONFIG SET maxmemory 4gb
redis-cli CONFIG REWRITE  # å°†å†…å­˜é…ç½®å†™å…¥é…ç½®æ–‡ä»¶
```

### 7.3 ç¯å¢ƒé…ç½®åˆ†ç¦»


#### ğŸ”§ å¤šç¯å¢ƒé…ç½®ç®¡ç†

```bash
# é…ç½®æ–‡ä»¶ç»„ç»‡ç»“æ„
/etc/redis/
â”œâ”€â”€ redis-common.conf         # é€šç”¨åŸºç¡€é…ç½®
â”œâ”€â”€ redis-dev.conf           # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ redis-test.conf          # æµ‹è¯•ç¯å¢ƒé…ç½®  
â”œâ”€â”€ redis-prod.conf          # ç”Ÿäº§ç¯å¢ƒé…ç½®
â””â”€â”€ scripts/
    â”œâ”€â”€ start-dev.sh         # å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
    â”œâ”€â”€ start-test.sh        # æµ‹è¯•ç¯å¢ƒå¯åŠ¨è„šæœ¬
    â””â”€â”€ start-prod.sh        # ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬

# ç¯å¢ƒé…ç½®ç»§æ‰¿
# redis-prod.conf
include /etc/redis/redis-common.conf
maxmemory 16gb
requirepass prod_password_2024
bind 10.0.1.100
```

---

## 8. ğŸ› é—®é¢˜æ’æŸ¥ä¸è§£å†³


### 8.1 å¸¸è§è¿æ¥é—®é¢˜è¯Šæ–­


#### ğŸ” è¿æ¥é—®é¢˜åˆ†ç±»

```
è¿æ¥é—®é¢˜åˆ†ç±»è¡¨ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é—®é¢˜ç±»å‹      â”‚     ç—‡çŠ¶è¡¨ç°    â”‚    å½±å“ç¨‹åº¦     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿æ¥æ•°è€—å°½      â”‚ è·å–è¿æ¥è¶…æ—¶    â”‚    ğŸ”´ ä¸¥é‡      â”‚
â”‚ è¿æ¥æ³„æ¼        â”‚ å¯ç”¨è¿æ¥é€æ¸å‡å°‘â”‚    ğŸŸ¡ ä¸­ç­‰      â”‚
â”‚ ç½‘ç»œè¶…æ—¶        â”‚ å‘½ä»¤æ‰§è¡Œè¶…æ—¶    â”‚    ğŸŸ¡ ä¸­ç­‰      â”‚
â”‚ è¿æ¥æ–­å¼€        â”‚ è¿æ¥å¼‚å¸¸æ–­å¼€    â”‚    ğŸŸ  è½»å¾®      â”‚
â”‚ é…ç½®é”™è¯¯        â”‚ æ— æ³•å»ºç«‹è¿æ¥    â”‚    ğŸ”´ ä¸¥é‡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ› ï¸ é—®é¢˜æ’æŸ¥å·¥å…·å‘½ä»¤

```bash
# è¿æ¥çŠ¶æ€æ£€æŸ¥å‘½ä»¤é›†
redis-cli info clients           # æŸ¥çœ‹å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯
redis-cli info stats             # æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
redis-cli client list            # åˆ—å‡ºæ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥
redis-cli config get maxclients  # æŸ¥çœ‹æœ€å¤§è¿æ¥æ•°é…ç½®

# å®æ—¶ç›‘æ§è¿æ¥
redis-cli --latency             # ç›‘æ§å»¶è¿Ÿ
redis-cli --latency-history     # å»¶è¿Ÿå†å²
redis-cli monitor               # å®æ—¶ç›‘æ§æ‰€æœ‰å‘½ä»¤

# ç³»ç»Ÿå±‚é¢æ£€æŸ¥
netstat -an | grep 6379         # æ£€æŸ¥TCPè¿æ¥çŠ¶æ€
ss -tuln | grep 6379           # æ£€æŸ¥ç›‘å¬çŠ¶æ€
lsof -i :6379                  # æŸ¥çœ‹ç«¯å£ä½¿ç”¨æƒ…å†µ
```

### 8.2 è¿æ¥é—®é¢˜è§£å†³æ–¹æ¡ˆ


#### ğŸš¨ è¿æ¥æ•°è€—å°½é—®é¢˜

```
é—®é¢˜ç°è±¡ï¼š
Exception: Could not get a resource from the pool

æ’æŸ¥æ­¥éª¤ï¼š
1ï¸âƒ£ æ£€æŸ¥è¿æ¥æ± é…ç½®
JedisPoolConfig config = pool.getPoolConfig();
System.out.println("æœ€å¤§è¿æ¥æ•°: " + config.getMaxTotal());
System.out.println("å½“å‰æ´»è·ƒ: " + pool.getNumActive());

2ï¸âƒ£ æ£€æŸ¥è¿æ¥æ³„æ¼  
# æŸ¥æ‰¾æœªæ­£ç¡®å…³é—­çš„è¿æ¥
redis-cli client list | grep idle=0

3ï¸âƒ£ å¢åŠ è¿æ¥æ± å¤§å°
config.setMaxTotal(500);  // é€‚å½“å¢åŠ 

4ï¸âƒ£ ä¼˜åŒ–ä»£ç ä½¿ç”¨
ç¡®ä¿ä½¿ç”¨try-with-resourcesæ­£ç¡®é‡Šæ”¾è¿æ¥
```

#### ğŸ”§ è¿æ¥è¶…æ—¶é—®é¢˜

```bash
# é—®é¢˜ï¼šredis.clients.jedis.exceptions.JedisConnectionException: Read timed out

æ’æŸ¥æ–¹å‘ï¼š

ç½‘ç»œå±‚é¢ï¼š
ping ç›®æ ‡RedisæœåŠ¡å™¨IP      # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
telnet RedisæœåŠ¡å™¨IP 6379   # æ£€æŸ¥ç«¯å£è¿é€šæ€§
traceroute RedisæœåŠ¡å™¨IP     # æ£€æŸ¥ç½‘ç»œè·¯å¾„

RedisæœåŠ¡å™¨å±‚é¢ï¼š
redis-cli info stats        # æŸ¥çœ‹æ‹’ç»è¿æ¥ç»Ÿè®¡
redis-cli info clients      # æŸ¥çœ‹å®¢æˆ·ç«¯è¿æ¥æƒ…å†µ
redis-cli slowlog get 10     # æŸ¥çœ‹æ…¢æŸ¥è¯¢

å®¢æˆ·ç«¯å±‚é¢ï¼š
å¢åŠ è¶…æ—¶æ—¶é—´ï¼šreadTimeout=10000
æ£€æŸ¥ç½‘ç»œç¯å¢ƒï¼šå†…ç½‘ vs å¤–ç½‘
ä¼˜åŒ–å‘½ä»¤ä½¿ç”¨ï¼šé¿å…å¤æ‚æ“ä½œ
```

### 8.3 æ€§èƒ½é—®é¢˜å®šä½


#### ğŸ“Š æ€§èƒ½åˆ†ææ–¹æ³•

```java
// è¿æ¥æ± æ€§èƒ½åˆ†æå·¥å…·
public class ConnectionPoolAnalyzer {
    
    public void analyzePerformance(JedisPool pool) {
        long startTime = System.currentTimeMillis();
        
        // æµ‹è¯•è¿æ¥è·å–é€Ÿåº¦
        try (Jedis jedis = pool.getResource()) {
            long getConnectionTime = System.currentTimeMillis() - startTime;
            
            // æµ‹è¯•å‘½ä»¤æ‰§è¡Œé€Ÿåº¦
            long cmdStart = System.currentTimeMillis();
            jedis.ping();
            long cmdTime = System.currentTimeMillis() - cmdStart;
            
            System.out.println("è·å–è¿æ¥è€—æ—¶: " + getConnectionTime + "ms");
            System.out.println("å‘½ä»¤æ‰§è¡Œè€—æ—¶: " + cmdTime + "ms");
            
            // æ€§èƒ½è¯„ä¼°
            if (getConnectionTime > 100) {
                System.out.println("âš ï¸ è¿æ¥è·å–è¾ƒæ…¢ï¼Œæ£€æŸ¥è¿æ¥æ± é…ç½®");
            }
            if (cmdTime > 10) {
                System.out.println("âš ï¸ å‘½ä»¤æ‰§è¡Œè¾ƒæ…¢ï¼Œæ£€æŸ¥ç½‘ç»œæˆ–RedisæœåŠ¡çŠ¶æ€");
            }
        }
    }
}
```

#### ğŸ” æ€§èƒ½ç“¶é¢ˆè¯†åˆ«

```
æ€§èƒ½ç“¶é¢ˆè¯†åˆ«çŸ©é˜µï¼š

è¿æ¥è·å–æ…¢ï¼ˆ>100msï¼‰ï¼š
åŸå› ï¼šè¿æ¥æ± é…ç½®è¿‡å°æˆ–è¿æ¥æ³„æ¼
è§£å†³ï¼šå¢åŠ maxTotalï¼Œæ£€æŸ¥ä»£ç è¿æ¥é‡Šæ”¾

å‘½ä»¤æ‰§è¡Œæ…¢ï¼ˆ>10msï¼‰ï¼š
åŸå› ï¼šç½‘ç»œå»¶è¿Ÿæˆ–RedisæœåŠ¡è´Ÿè½½é«˜
è§£å†³ï¼šä¼˜åŒ–ç½‘ç»œï¼Œæ£€æŸ¥Redisæ€§èƒ½

æ‰¹é‡æ“ä½œæ…¢ï¼š
åŸå› ï¼šæœªä½¿ç”¨Pipelineæˆ–æ‰¹é‡å‘½ä»¤
è§£å†³ï¼šä½¿ç”¨Pipelineæˆ–MGET/MSET

å†…å­˜ä½¿ç”¨é«˜ï¼š
åŸå› ï¼šè¿æ¥æ•°è¿‡å¤šæˆ–å†…å­˜æ³„æ¼
è§£å†³ï¼šä¼˜åŒ–è¿æ¥é…ç½®ï¼Œæ£€æŸ¥å†…å­˜ä½¿ç”¨
```

---

## 9. ğŸ’¯ æœ€ä½³å®è·µæ€»ç»“


### 9.1 è¿æ¥æ± é…ç½®æœ€ä½³å®è·µ


> ğŸ¯ **ç”Ÿäº§ç¯å¢ƒè¿æ¥æ± é…ç½®æ£€æŸ¥æ¸…å•**
> 
> - [x] **åˆç†è®¾ç½®æœ€å¤§è¿æ¥æ•°**ï¼šæ ¹æ®å¹¶å‘éœ€æ±‚è®¡ç®—
> - [x] **é…ç½®ç©ºé—²è¿æ¥ç®¡ç†**ï¼šä¿æŒé€‚å½“çš„ç©ºé—²è¿æ¥
> - [x] **è®¾ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´**ï¼šå¹³è¡¡æ€§èƒ½å’Œç¨³å®šæ€§
> - [x] **å¯ç”¨è¿æ¥æ£€æµ‹æœºåˆ¶**ï¼šåŠæ—¶å‘ç°å¤±æ•ˆè¿æ¥
> - [x] **å®æ–½è¿æ¥æ± ç›‘æ§**ï¼šç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
> - [x] **åˆ¶å®šæ•…éšœåº”æ€¥é¢„æ¡ˆ**ï¼šè¿æ¥é—®é¢˜å¿«é€Ÿå¤„ç†æµç¨‹

### 9.2 ç½‘ç»œä¼˜åŒ–æœ€ä½³å®è·µ


```
ç½‘ç»œä¼˜åŒ–ç­–ç•¥ç»„åˆï¼š

åŸºç¡€ä¼˜åŒ–ï¼š
ğŸ”¸ å¯ç”¨TCP_NODELAY â†’ å‡å°‘å»¶è¿Ÿ
ğŸ”¸ ä½¿ç”¨é•¿è¿æ¥ â†’ å‡å°‘å»ºè¿å¼€é”€
ğŸ”¸ é…ç½®åˆé€‚çš„ä¿æ´»å‚æ•° â†’ ç»´æŒè¿æ¥ç¨³å®š

é«˜çº§ä¼˜åŒ–ï¼š
ğŸ”¸ Pipelineæ‰¹é‡æ“ä½œ â†’ å‡å°‘ç½‘ç»œå¾€è¿”
ğŸ”¸ æœ¬åœ°åŒ–éƒ¨ç½² â†’ é™ä½ç½‘ç»œå»¶è¿Ÿ  
ğŸ”¸ è¿æ¥å¤ç”¨ â†’ æé«˜è¿æ¥åˆ©ç”¨ç‡

ç›‘æ§ä¼˜åŒ–ï¼š
ğŸ”¸ å®æ—¶ç›‘æ§ç½‘ç»œå»¶è¿Ÿ
ğŸ”¸ åˆ†æå‘½ä»¤æ‰§è¡Œæ€§èƒ½
ğŸ”¸ ä¼˜åŒ–å®¢æˆ·ç«¯é…ç½®å‚æ•°
```

### 9.3 æ•…éšœé¢„é˜²æªæ–½


#### ğŸ›¡ï¸ é¢„é˜²æ€§é…ç½®

```java
// å¥å£®çš„è¿æ¥æ± é…ç½®
JedisPoolConfig robustConfig = new JedisPoolConfig();

// è¿æ¥æ•°é…ç½® - é¢„ç•™å……è¶³èµ„æº
robustConfig.setMaxTotal(300);          // è¶³å¤Ÿçš„æœ€å¤§è¿æ¥
robustConfig.setMaxIdle(100);           // å……è¶³çš„ç©ºé—²è¿æ¥
robustConfig.setMinIdle(20);            // ä¿åº•çš„ç©ºé—²è¿æ¥

// è¶…æ—¶é…ç½® - å¿«é€Ÿå¤±è´¥
robustConfig.setMaxWaitMillis(2000);    // 2ç§’è·å–ä¸åˆ°è¿æ¥å°±å¤±è´¥

// æ£€æµ‹é…ç½® - å…¨é¢æ£€æµ‹
robustConfig.setTestOnBorrow(true);     // å€Ÿç”¨æ—¶æ£€æµ‹
robustConfig.setTestOnReturn(true);     // å½’è¿˜æ—¶æ£€æµ‹
robustConfig.setTestWhileIdle(true);    // ç©ºé—²æ—¶æ£€æµ‹

// æ¸…ç†é…ç½® - åŠæ—¶æ¸…ç†
robustConfig.setTimeBetweenEvictionRunsMillis(30000);  // 30ç§’æ¸…ç†ä¸€æ¬¡
robustConfig.setMinEvictableIdleTimeMillis(300000);    // 5åˆ†é’Ÿç©ºé—²å¯æ¸…ç†

// å¼‚å¸¸å¤„ç†é…ç½®
robustConfig.setBlockWhenExhausted(true);  // è¿æ¥è€—å°½æ—¶é˜»å¡ç­‰å¾…
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¿æ¥æ± æœ¬è´¨ï¼šå¤ç”¨TCPè¿æ¥ï¼Œæå‡æ€§èƒ½å’Œå¹¶å‘èƒ½åŠ›
ğŸ”¸ æ ¸å¿ƒå‚æ•°ï¼šæœ€å¤§è¿æ¥æ•°ã€ç©ºé—²è¿æ¥ã€è¶…æ—¶è®¾ç½®ã€æ£€æµ‹æœºåˆ¶
ğŸ”¸ ç½‘ç»œä¼˜åŒ–ï¼šPipelineã€é•¿è¿æ¥ã€TCP_NODELAYã€æœ¬åœ°åŒ–éƒ¨ç½²
ğŸ”¸ å®¢æˆ·ç«¯ä¼˜åŒ–ï¼šæ­£ç¡®ä½¿ç”¨è¿æ¥ã€æ‰¹é‡æ“ä½œã€åŸå­æ“ä½œè®¾è®¡
ğŸ”¸ ç”Ÿäº§é…ç½®ï¼šå®‰å…¨æ€§ã€ç¨³å®šæ€§ã€ç›‘æ§ã€æ•…éšœå¤„ç†
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¿æ¥æ± ä¸ºä»€ä¹ˆèƒ½æå‡æ€§èƒ½**
```
æ ¸å¿ƒåŸç†ï¼š
å»ºç«‹TCPè¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ â†’ è€—æ—¶1-5ms
Rediså‘½ä»¤æ‰§è¡Œåªéœ€è¦ â†’ 0.1-1ms
å»ºè¿æ—¶é—´æ˜¯å‘½ä»¤æ‰§è¡Œæ—¶é—´çš„5-50å€

è¿æ¥æ± æ•ˆæœï¼š
âŒ æ— è¿æ¥æ± ï¼šæ¯ä¸ªè¯·æ±‚éƒ½è¦å»ºè¿ï¼Œæ€»æ—¶é—´=å»ºè¿æ—¶é—´+æ‰§è¡Œæ—¶é—´
âœ… æœ‰è¿æ¥æ± ï¼šå¤ç”¨è¿æ¥ï¼Œæ€»æ—¶é—´â‰ˆæ‰§è¡Œæ—¶é—´
æ€§èƒ½æå‡ï¼š50%-90%çš„å“åº”æ—¶é—´å‡å°‘
```

**ğŸ”¹ é…ç½®å‚æ•°çš„å¹³è¡¡è‰ºæœ¯**
```
è¿æ¥æ•°é…ç½®å¹³è¡¡ï¼š
å¤ªå°‘ â†’ å¹¶å‘ä¸è¶³ï¼Œè¯·æ±‚æ’é˜Ÿç­‰å¾…
å¤ªå¤š â†’ èµ„æºæµªè´¹ï¼ŒRediså‹åŠ›å¤§
åˆé€‚ â†’ æ»¡è¶³å¹¶å‘éœ€æ±‚ï¼Œèµ„æºåˆ©ç”¨åˆç†

è¶…æ—¶é…ç½®å¹³è¡¡ï¼š  
å¤ªçŸ­ â†’ ç½‘ç»œæŠ–åŠ¨æ—¶å®¹æ˜“è¶…æ—¶å¤±è´¥
å¤ªé•¿ â†’ æ•…éšœæ—¶æ¢å¤æ…¢ï¼Œç”¨æˆ·ä½“éªŒå·®
åˆé€‚ â†’ å…¼é¡¾ç¨³å®šæ€§å’Œå“åº”é€Ÿåº¦

æ£€æµ‹é…ç½®å¹³è¡¡ï¼š
å¤ªé¢‘ç¹ â†’ é¢å¤–å¼€é”€å¤§ï¼Œå½±å“æ€§èƒ½
å¤ªç¨€å°‘ â†’ æ— æ•ˆè¿æ¥æ¸…ç†ä¸åŠæ—¶
åˆé€‚ â†’ åŠæ—¶å‘ç°é—®é¢˜ï¼Œå¼€é”€å¯æ§
```

**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒçš„ç‰¹æ®Šè¦æ±‚**
```
å¯é æ€§è¦æ±‚ï¼š
âœ“ é…ç½®ä¿å®ˆä¸€äº›ï¼Œç•™è¶³å®‰å…¨è¾¹é™…
âœ“ å…¨é¢çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
âœ“ è¯¦ç»†çš„æ•…éšœå¤„ç†é¢„æ¡ˆ

æ€§èƒ½è¦æ±‚ï¼š
âœ“ æ ¹æ®å®é™…è´Ÿè½½è°ƒä¼˜å‚æ•°  
âœ“ æŒç»­ç›‘æ§å’Œä¼˜åŒ–
âœ“ é¢„ç•™æ‰©å®¹ç©ºé—´

å®‰å…¨è¦æ±‚ï¼š
âœ“ ç½‘ç»œè®¿é—®æ§åˆ¶
âœ“ å‘½ä»¤æƒé™æ§åˆ¶
âœ“ é…ç½®å˜æ›´å®¡è®¡
```

### 10.3 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ“š æŒæ¡å±‚æ¬¡**ï¼š
```
åŸºç¡€çº§åˆ«ï¼š
- ç†è§£è¿æ¥æ± åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨
- ä¼šé…ç½®åŸºæœ¬çš„è¿æ¥æ± å‚æ•°
- èƒ½è§£å†³ç®€å•çš„è¿æ¥é—®é¢˜

è¿›é˜¶çº§åˆ«ï¼š  
- æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹ä¼˜åŒ–è¿æ¥æ± é…ç½®
- ç†Ÿç»ƒä½¿ç”¨Pipelineç­‰ä¼˜åŒ–æŠ€æœ¯
- èƒ½è¿›è¡Œæ€§èƒ½åˆ†æå’Œè°ƒä¼˜

ä¸“å®¶çº§åˆ«ï¼š
- è®¾è®¡é«˜å¯ç”¨çš„è¿æ¥æ¶æ„
- å¤„ç†å¤æ‚çš„åˆ†å¸ƒå¼è¿æ¥é—®é¢˜
- åˆ¶å®šä¼ä¸šçº§è¿æ¥ç®¡ç†è§„èŒƒ
```

### 10.4 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ–°æ‰‹é¿å‘æŒ‡å—**ï¼š
- è¿æ¥ç”¨å®Œå¿…é¡»å½’è¿˜ï¼Œå¦åˆ™è¿æ¥æ± è€—å°½
- ä¸è¦åœ¨è·å–è¿æ¥ååšè€—æ—¶æ“ä½œ
- å¼‚å¸¸å¤„ç†æ—¶ä¹Ÿè¦ç¡®ä¿è¿æ¥é‡Šæ”¾
- å®šæœŸç›‘æ§è¿æ¥æ± çŠ¶æ€

**ğŸ”§ è¿ç»´ç®¡ç†è¦ç‚¹**ï¼š
- å»ºç«‹è¿æ¥æ± ç›‘æ§å¤§ç›˜
- è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼  
- å®šæœŸåˆ†æè¿æ¥ä½¿ç”¨æ¨¡å¼
- åˆ¶å®šè¿æ¥æ•…éšœå¤„ç†æµç¨‹

**æ ¸å¿ƒè®°å¿†**ï¼š
> ğŸ§  *"è¿æ¥æ± åƒåœè½¦åœºï¼Œé¢„å¤‡è½¦ä½ä¾›ä½¿ç”¨ï¼›*  
> *é…ç½®å‚æ•°è¦å¹³è¡¡ï¼Œç›‘æ§å‘Šè­¦ä¸èƒ½å°‘ï¼›*  
> *Pipelineæ‰¹é‡æœ€é«˜æ•ˆï¼Œé•¿è¿æ¥å‡å°‘å»ºè¿å¿™ï¼›*  
> *ç”Ÿäº§é…ç½®è¦ä¿å®ˆï¼Œå®‰å…¨ç¨³å®šç¬¬ä¸€ä½ï¼"*