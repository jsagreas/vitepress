---
title: 5ã€å¸¸è§æ€§èƒ½é—®é¢˜åˆ†æ
---
## ğŸ“š ç›®å½•

1. [æ…¢æŸ¥è¯¢åˆ†æ](#1-æ…¢æŸ¥è¯¢åˆ†æ)
2. [å†…å­˜æ»¡é—®é¢˜](#2-å†…å­˜æ»¡é—®é¢˜)
3. [é˜»å¡å‘½ä»¤å¤„ç†](#3-é˜»å¡å‘½ä»¤å¤„ç†)
4. [ç›‘æ§å‘½ä»¤MONITOR](#4-ç›‘æ§å‘½ä»¤monitor)
5. [INFOå‘½ä»¤è¯¦è§£](#5-infoå‘½ä»¤è¯¦è§£)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ æ…¢æŸ¥è¯¢åˆ†æ


### 1.1 ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢


**åŸºæœ¬æ¦‚å¿µ**
æ…¢æŸ¥è¯¢å°±æ˜¯æ‰§è¡Œæ—¶é—´è¶…è¿‡é¢„è®¾é˜ˆå€¼çš„Rediså‘½ä»¤ã€‚Redisæ˜¯å•çº¿ç¨‹å¤„ç†å‘½ä»¤çš„ï¼Œä¸€ä¸ªæ…¢æŸ¥è¯¢ä¼šé˜»å¡åç»­æ‰€æœ‰å‘½ä»¤çš„æ‰§è¡Œã€‚

```
æ­£å¸¸æƒ…å†µä¸‹Rediså‘½ä»¤æ‰§è¡Œï¼š
å‘½ä»¤A â”€â”€â–¶ 1ms â”€â”€â–¶ å‘½ä»¤B â”€â”€â–¶ 1ms â”€â”€â–¶ å‘½ä»¤C â”€â”€â–¶ 1ms

å‡ºç°æ…¢æŸ¥è¯¢æ—¶ï¼š
å‘½ä»¤A â”€â”€â–¶ 1ms â”€â”€â–¶ æ…¢æŸ¥è¯¢ â”€â”€â–¶ 500ms â”€â”€â–¶ å‘½ä»¤C â”€â”€â–¶ ç­‰å¾…ä¸­...
                      â†‘
                 é˜»å¡äº†åé¢çš„å‘½ä»¤
```

### 1.2 æ…¢æŸ¥è¯¢é…ç½®


**å…³é”®å‚æ•°é…ç½®**
```bash
# æ…¢æŸ¥è¯¢æ—¶é—´é˜ˆå€¼ï¼ˆå¾®ç§’ï¼Œé»˜è®¤10000å¾®ç§’=10æ¯«ç§’ï¼‰
CONFIG SET slowlog-log-slower-than 10000

# æ…¢æŸ¥è¯¢æ—¥å¿—é•¿åº¦ï¼ˆé»˜è®¤128æ¡ï¼‰
CONFIG SET slowlog-max-len 1000

# æŸ¥çœ‹å½“å‰é…ç½®
CONFIG GET slowlog*
```

**ğŸ’¡ é˜ˆå€¼è®¾ç½®å»ºè®®**
- **é«˜QPSåœºæ™¯**ï¼šè®¾ç½®ä¸º1000å¾®ç§’(1æ¯«ç§’)
- **æ™®é€šåœºæ™¯**ï¼šè®¾ç½®ä¸º10000å¾®ç§’(10æ¯«ç§’) 
- **ä½å»¶è¿Ÿè¦æ±‚**ï¼šè®¾ç½®ä¸º100å¾®ç§’(0.1æ¯«ç§’)

### 1.3 æ…¢æŸ¥è¯¢æ—¥å¿—æŸ¥çœ‹


**æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—**
```bash
# æŸ¥çœ‹æœ€è¿‘10æ¡æ…¢æŸ¥è¯¢
SLOWLOG GET 10

# æŸ¥çœ‹æ…¢æŸ¥è¯¢æ€»æ•°
SLOWLOG LEN

# æ¸…ç©ºæ…¢æŸ¥è¯¢æ—¥å¿—
SLOWLOG RESET
```

**æ—¥å¿—æ ¼å¼è§£è¯»**
```bash
# æ…¢æŸ¥è¯¢æ—¥å¿—ç¤ºä¾‹
1) 1) (integer) 12                    # æ—¥å¿—ID
   2) (integer) 1629360000           # æ‰§è¡Œæ—¶é—´æˆ³
   3) (integer) 50000                # æ‰§è¡Œæ—¶é•¿(å¾®ç§’)
   4) 1) "KEYS"                      # å‘½ä»¤åç§°
      2) "user:*"                    # å‘½ä»¤å‚æ•°
   5) "127.0.0.1:6379"              # å®¢æˆ·ç«¯ä¿¡æ¯
   6) ""                            # å®¢æˆ·ç«¯åç§°
```

### 1.4 å¸¸è§æ…¢æŸ¥è¯¢å‘½ä»¤


| å‘½ä»¤ç±»å‹ | **å…¸å‹å‘½ä»¤** | **ä¸ºä»€ä¹ˆæ…¢** | **æ›¿ä»£æ–¹æ¡ˆ** |
|---------|-------------|-------------|-------------|
| ğŸ” **å…¨é‡æ‰«æ** | `KEYS *` | æ‰«ææ•´ä¸ªé”®ç©ºé—´ | ä½¿ç”¨`SCAN`å‘½ä»¤ |
| ğŸ“Š **èšåˆæ“ä½œ** | `SORT key` | éœ€è¦æ’åºå¤§é‡æ•°æ® | åº”ç”¨å±‚æ’åº |
| ğŸ—‘ï¸ **æ‰¹é‡åˆ é™¤** | `FLUSHALL` | åˆ é™¤æ‰€æœ‰æ•°æ® | åˆ†æ‰¹`DEL`æ“ä½œ |
| ğŸ“¦ **å¤§é›†åˆ** | `SMEMBERS big_set` | è¿”å›å¤§é‡å…ƒç´  | ä½¿ç”¨`SSCAN` |
| ğŸ”„ **é˜»å¡æ“ä½œ** | `BLPOP list 0` | æ— é™æœŸé˜»å¡ | è®¾ç½®åˆç†è¶…æ—¶ |

**ğŸš¨ æœ€å±é™©çš„æ…¢æŸ¥è¯¢å‘½ä»¤**
```bash
# è¿™äº›å‘½ä»¤åœ¨ç”Ÿäº§ç¯å¢ƒè¦è°¨æ…ä½¿ç”¨ï¼
KEYS pattern      # ä¼šæ‰«ææ•´ä¸ªé”®ç©ºé—´
FLUSHALL         # åˆ é™¤æ‰€æœ‰æ•°æ®
FLUSHDB          # åˆ é™¤å½“å‰æ•°æ®åº“æ‰€æœ‰æ•°æ®
DEBUG commands   # è°ƒè¯•å‘½ä»¤ï¼Œç”Ÿäº§ç¯å¢ƒç¦ç”¨
```

### 1.5 æ…¢æŸ¥è¯¢è§£å†³æ–¹æ¡ˆ


**ğŸ”§ è§£å†³ç­–ç•¥**

```bash
# 1. ç”¨SCANæ›¿ä»£KEYS
# é”™è¯¯æ–¹å¼ï¼š
KEYS user:*

# æ­£ç¡®æ–¹å¼ï¼š
SCAN 0 MATCH user:* COUNT 100
```

```bash
# 2. åˆ†æ‰¹å¤„ç†å¤§æ•°æ®
# é”™è¯¯æ–¹å¼ï¼š
SMEMBERS big_set

# æ­£ç¡®æ–¹å¼ï¼š
SSCAN big_set 0 COUNT 50
```

**é¢„é˜²æªæ–½**
- **å¼€å‘è§„èŒƒ**ï¼šç¦ç”¨å±é™©å‘½ä»¤
- **ä»£ç å®¡æŸ¥**ï¼šæ£€æŸ¥å¯èƒ½çš„æ…¢æŸ¥è¯¢
- **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®æ…¢æŸ¥è¯¢ç›‘æ§
- **å®šæœŸæ£€æŸ¥**ï¼šåˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—

---

## 2. ğŸ’¾ å†…å­˜æ»¡é—®é¢˜


### 2.1 å†…å­˜æ»¡çš„è¡¨ç°


**å…¸å‹ç—‡çŠ¶**
```bash
# å†…å­˜ä¸è¶³æ—¶çš„é”™è¯¯ä¿¡æ¯
(error) OOM command not allowed when used memory > 'maxmemory'

# å†™æ“ä½œè¢«æ‹’ç»ï¼Œè¯»æ“ä½œæ­£å¸¸
SET key value  # å¤±è´¥
GET key        # æˆåŠŸ
```

**ğŸš¨ å†…å­˜æ»¡çš„å½±å“**
- **å†™æ“ä½œå¤±è´¥**ï¼šæ— æ³•æ‰§è¡ŒSETã€HSETç­‰å†™å‘½ä»¤
- **æ•°æ®ä¸¢å¤±é£é™©**ï¼šå¯èƒ½è§¦å‘å†…å­˜æ·˜æ±°ç­–ç•¥
- **æ€§èƒ½ä¸‹é™**ï¼šé¢‘ç¹çš„å†…å­˜å›æ”¶å½±å“æ€§èƒ½
- **æœåŠ¡ä¸å¯ç”¨**ï¼šä¸¥é‡æ—¶å¯èƒ½å¯¼è‡´Rediså´©æºƒ

### 2.2 å†…å­˜é…ç½®ç®¡ç†


**å†…å­˜é™åˆ¶è®¾ç½®**
```bash
# è®¾ç½®æœ€å¤§å†…å­˜é™åˆ¶ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰
CONFIG SET maxmemory 2gb
CONFIG SET maxmemory 2147483648

# æŸ¥çœ‹å†…å­˜é…ç½®
CONFIG GET maxmemory

# æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨
INFO memory
```

**ğŸ’¡ å†…å­˜è®¾ç½®å»ºè®®**
- **ç‰©ç†å†…å­˜çš„70-80%**ï¼šä¸ºç³»ç»Ÿå’Œå…¶ä»–è¿›ç¨‹é¢„ç•™ç©ºé—´
- **è€ƒè™‘æŒä¹…åŒ–å¼€é”€**ï¼šRDBéœ€è¦é¢å¤–å†…å­˜ï¼ŒAOFéœ€è¦ç£ç›˜ç©ºé—´
- **ç›‘æ§å†…å­˜ä½¿ç”¨è¶‹åŠ¿**ï¼šæå‰å‘ç°å†…å­˜å¢é•¿å¼‚å¸¸

### 2.3 å†…å­˜æ·˜æ±°ç­–ç•¥


**æ·˜æ±°ç­–ç•¥é…ç½®**
```bash
# è®¾ç½®å†…å­˜æ·˜æ±°ç­–ç•¥
CONFIG SET maxmemory-policy allkeys-lru

# æŸ¥çœ‹å½“å‰ç­–ç•¥
CONFIG GET maxmemory-policy
```

**ğŸ¯ æ·˜æ±°ç­–ç•¥è¯¦è§£**

| ç­–ç•¥ | **è¯´æ˜** | **é€‚ç”¨åœºæ™¯** |
|------|---------|-------------|
| `noeviction` | ä¸æ·˜æ±°ï¼Œå†…å­˜æ»¡æ—¶æ‹’ç»å†™å…¥ | æ•°æ®ä¸èƒ½ä¸¢å¤±çš„åœºæ™¯ |
| `allkeys-lru` | **æœ€å¸¸ç”¨**ï¼Œæ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key | é€šç”¨åœºæ™¯ï¼Œæ¨èä½¿ç”¨ |
| `volatile-lru` | åªæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­LRUçš„ | éƒ¨åˆ†æ•°æ®å¯ä»¥ä¸¢å¤± |
| `allkeys-random` | éšæœºæ·˜æ±°ä»»æ„key | å¯¹æ·˜æ±°ç­–ç•¥ä¸æ•æ„Ÿ |
| `volatile-random` | éšæœºæ·˜æ±°æœ‰è¿‡æœŸæ—¶é—´çš„key | ç®€å•åœºæ™¯ |
| `volatile-ttl` | æ·˜æ±°å³å°†è¿‡æœŸçš„key | ä¼˜å…ˆæ¸…ç†å¿«è¿‡æœŸçš„æ•°æ® |

### 2.4 å†…å­˜ä½¿ç”¨åˆ†æ


**æŸ¥çœ‹å†…å­˜è¯¦ç»†ä¿¡æ¯**
```bash
# å†…å­˜ä½¿ç”¨ç»Ÿè®¡
INFO memory

# å…³é”®æŒ‡æ ‡è§£è¯»ï¼š
used_memory:838860800          # å·²ä½¿ç”¨å†…å­˜ï¼ˆå­—èŠ‚ï¼‰
used_memory_human:800.00M      # äººç±»å¯è¯»æ ¼å¼
used_memory_rss:1055916032     # ç³»ç»Ÿåˆ†é…çš„å†…å­˜
maxmemory:2147483648          # æœ€å¤§å†…å­˜é™åˆ¶
maxmemory_human:2.00G         # æœ€å¤§å†…å­˜ï¼ˆå¯è¯»ï¼‰
```

**ğŸ” å†…å­˜ä½¿ç”¨åˆ†æ**
```bash
# æŸ¥çœ‹æ•°æ®åº“é”®å€¼ç»Ÿè®¡
INFO keyspace
# db0:keys=1000,expires=100,avg_ttl=3600

# åˆ†æå¤§keyï¼ˆéœ€è¦å®‰è£…redis-rdb-toolsï¼‰
redis-cli --bigkeys

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨åˆ†å¸ƒ
MEMORY USAGE key_name
```

### 2.5 å†…å­˜æ»¡è§£å†³æ–¹æ¡ˆ


**ğŸ“‹ è§£å†³æ­¥éª¤æ¸…å•**
```
â–¡ 1. ç«‹å³æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
â–¡ 2. åˆ†ææ˜¯å¦æœ‰å¤§keyæˆ–å¼‚å¸¸å¢é•¿
â–¡ 3. æ£€æŸ¥è¿‡æœŸæ—¶é—´è®¾ç½®æ˜¯å¦åˆç†
â–¡ 4. è€ƒè™‘è°ƒæ•´æ·˜æ±°ç­–ç•¥
â–¡ 5. æ¸…ç†ä¸å¿…è¦çš„æ•°æ®
â–¡ 6. å‡çº§å†…å­˜æˆ–æ‰©å®¹
```

**ç´§æ€¥å¤„ç†æ–¹æ¡ˆ**
```bash
# 1. ä¸´æ—¶å¢åŠ å†…å­˜é™åˆ¶
CONFIG SET maxmemory 4gb

# 2. å¯ç”¨å†…å­˜æ·˜æ±°
CONFIG SET maxmemory-policy allkeys-lru

# 3. æ‰‹åŠ¨æ¸…ç†å¤§key
DEL big_key1 big_key2

# 4. æ¸…ç†è¿‡æœŸkey
# Redisä¼šè‡ªåŠ¨æ¸…ç†ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘
```

---

## 3. â¸ï¸ é˜»å¡å‘½ä»¤å¤„ç†


### 3.1 ä»€ä¹ˆæ˜¯é˜»å¡å‘½ä»¤


**åŸºæœ¬æ¦‚å¿µ**
é˜»å¡å‘½ä»¤æ˜¯æŒ‡åœ¨æ²¡æœ‰æ•°æ®å¯å¤„ç†æ—¶ä¼šè®©å®¢æˆ·ç«¯ç­‰å¾…çš„å‘½ä»¤ï¼Œç›´åˆ°æœ‰æ•°æ®æˆ–è¶…æ—¶æ‰è¿”å›ã€‚

```
é˜»å¡å‘½ä»¤çš„å·¥ä½œåŸç†ï¼š
            
å®¢æˆ·ç«¯A: BLPOP mylist 30  â”€â”€â–¶ ç­‰å¾…30ç§’
         (å¦‚æœmylistä¸ºç©º)     â”‚
                            â”‚ é˜»å¡ä¸­...
å®¢æˆ·ç«¯B: LPUSH mylist "data" â”‚
                            â–¼
å®¢æˆ·ç«¯A:                   ç«‹å³è¿”å›"data"
```

### 3.2 å¸¸è§é˜»å¡å‘½ä»¤


**åˆ—è¡¨é˜»å¡å‘½ä»¤**
```bash
# é˜»å¡å¼å·¦å¼¹å‡ºï¼ˆä»å·¦è¾¹å–å…ƒç´ ï¼‰
BLPOP key1 key2 timeout

# é˜»å¡å¼å³å¼¹å‡ºï¼ˆä»å³è¾¹å–å…ƒç´ ï¼‰  
BRPOP key1 key2 timeout

# é˜»å¡å¼å³å¼¹å·¦æ¨ï¼ˆä»ä¸€ä¸ªåˆ—è¡¨ç§»åˆ°å¦ä¸€ä¸ªï¼‰
BRPOPLPUSH source destination timeout
```

**å…¶ä»–é˜»å¡å‘½ä»¤**
```bash
# æœ‰åºé›†åˆé˜»å¡å¼¹å‡º
BZPOPMIN key timeout     # å¼¹å‡ºæœ€å°åˆ†å€¼å…ƒç´ 
BZPOPMAX key timeout     # å¼¹å‡ºæœ€å¤§åˆ†å€¼å…ƒç´ 

# Streamæµçš„é˜»å¡è¯»å–
XREAD BLOCK timeout STREAMS stream_key id
```

### 3.3 è¶…æ—¶æ—¶é—´è®¾ç½®


**timeoutå‚æ•°å«ä¹‰**
```bash
# timeout=0ï¼šæ— é™æœŸç­‰å¾…ï¼ˆå±é™©ï¼ï¼‰
BLPOP mylist 0

# timeout>0ï¼šç­‰å¾…æŒ‡å®šç§’æ•°åè¶…æ—¶è¿”å›nil
BLPOP mylist 30    # æœ€å¤šç­‰å¾…30ç§’

# è¿”å›å€¼è§£æ
1) "mylist"        # æ•°æ®æ¥æºçš„keyåç§°  
2) "item_value"    # å¼¹å‡ºçš„æ•°æ®
# æˆ–è€…è¿”å› (nil) è¡¨ç¤ºè¶…æ—¶
```

**âš ï¸ è¶…æ—¶è®¾ç½®å»ºè®®**
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šè®¾ç½®åˆç†è¶…æ—¶æ—¶é—´ï¼ˆå¦‚30ç§’ï¼‰
- **é¿å…0è¶…æ—¶**ï¼šæ— é™ç­‰å¾…å¯èƒ½å¯¼è‡´è¿æ¥å †ç§¯
- **å®¢æˆ·ç«¯é‡è¯•**ï¼šè¶…æ—¶åå¯ä»¥é‡æ–°å‘èµ·è¯·æ±‚

### 3.4 é˜»å¡å‘½ä»¤çš„æ€§èƒ½å½±å“


**æ€§èƒ½é—®é¢˜åˆ†æ**
```
é—®é¢˜åœºæ™¯ï¼š
1. å¤§é‡å®¢æˆ·ç«¯æ‰§è¡ŒBLPOPå‘½ä»¤é˜»å¡ç­‰å¾…
2. Rediséœ€è¦ç»´æŠ¤è¿™äº›é˜»å¡çš„å®¢æˆ·ç«¯è¿æ¥
3. å½“æœ‰æ•°æ®æ—¶ï¼Œéœ€è¦å”¤é†’ç­‰å¾…çš„å®¢æˆ·ç«¯

èµ„æºæ¶ˆè€—ï¼š
â”œâ”€â”€ å†…å­˜ï¼šç»´æŠ¤é˜»å¡å®¢æˆ·ç«¯åˆ—è¡¨
â”œâ”€â”€ è¿æ¥ï¼šå ç”¨è¿æ¥æ± èµ„æº  
â””â”€â”€ CPUï¼šå”¤é†’å®¢æˆ·ç«¯æ—¶çš„å¤„ç†å¼€é”€
```

**ğŸ”§ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
- **åˆç†è®¾ç½®è¿æ¥æ± **ï¼šé¿å…è¿æ¥è€—å°½
- **æ§åˆ¶é˜»å¡å®¢æˆ·ç«¯æ•°é‡**ï¼šç›‘æ§å¹¶å‘é˜»å¡è¿æ¥
- **ä½¿ç”¨éé˜»å¡æ›¿ä»£**ï¼šè€ƒè™‘è½®è¯¢+çŸ­å»¶è¿Ÿæ–¹å¼
- **é›†ç¾¤åŒ–å¤„ç†**ï¼šåˆ†æ•£é˜»å¡å‹åŠ›åˆ°å¤šä¸ªå®ä¾‹

### 3.5 é˜»å¡å‘½ä»¤æœ€ä½³å®è·µ


**ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å»ºè®®**
```bash
# 1. æ¶ˆæ¯é˜Ÿåˆ—åœºæ™¯ï¼ˆæ¨èï¼‰
BLPOP task_queue 30          # 30ç§’è¶…æ—¶
if timeout:
    continue                 # ç»§ç»­ä¸‹ä¸€è½®ç­‰å¾…

# 2. å®æ—¶é€šçŸ¥åœºæ™¯
BLPOP notification_queue 5   # çŸ­è¶…æ—¶
if timeout:
    check_other_sources()    # æ£€æŸ¥å…¶ä»–æ•°æ®æº

# 3. é¿å…çš„åšæ³•ï¼ˆå±é™©ï¼‰
BLPOP queue 0               # æ— é™ç­‰å¾…ï¼Œå±é™©ï¼
```

**å®ç°æ¶ˆæ¯é˜Ÿåˆ—ç¤ºä¾‹**
```python
# Pythonä¸­ä½¿ç”¨Redisé˜»å¡é˜Ÿåˆ—
import redis

r = redis.Redis()

# æ¶ˆè´¹è€…
def consumer():
    while True:
        # é˜»å¡ç­‰å¾…æ¶ˆæ¯ï¼Œ30ç§’è¶…æ—¶
        result = r.blpop(['task_queue'], timeout=30)
        if result:
            queue_name, message = result
            process_message(message.decode())
        else:
            # è¶…æ—¶ï¼Œè¿›è¡Œå¥åº·æ£€æŸ¥æˆ–å…¶ä»–æ“ä½œ
            health_check()

# ç”Ÿäº§è€…  
def producer(message):
    r.lpush('task_queue', message)
```

---

## 4. ğŸ‘€ ç›‘æ§å‘½ä»¤MONITOR


### 4.1 MONITORå‘½ä»¤ä½œç”¨


**åŸºæœ¬æ¦‚å¿µ**
MONITORå‘½ä»¤å¯ä»¥å®æ—¶ç›‘æ§RedisæœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ‰€æœ‰å‘½ä»¤ï¼Œç›¸å½“äºç»™Redisè£…äº†ä¸€ä¸ª"ç›‘æ§æ‘„åƒå¤´"ã€‚

```
MONITORå‘½ä»¤çš„ä½œç”¨ï¼š
                    
Redis Server â†â”€â”€â”€ å®¢æˆ·ç«¯A: SET user:1 "Alice"
     â”‚      â†â”€â”€â”€ å®¢æˆ·ç«¯B: GET user:1  
     â”‚      â†â”€â”€â”€ å®¢æˆ·ç«¯C: HSET user:2 name "Bob"
     â–¼
ç›‘æ§å®¢æˆ·ç«¯çœ‹åˆ°ï¼š
1629360001.123456 [0 127.0.0.1:6379] "SET" "user:1" "Alice"
1629360002.456789 [0 127.0.0.1:6379] "GET" "user:1"  
1629360003.789012 [0 127.0.0.1:6379] "HSET" "user:2" "name" "Bob"
```

### 4.2 MONITORä½¿ç”¨æ–¹æ³•


**å¯åŠ¨ç›‘æ§**
```bash
# å¼€å§‹ç›‘æ§ï¼ˆä¼šæŒç»­æ˜¾ç¤ºå‘½ä»¤ï¼‰
redis-cli MONITOR

# è¾“å‡ºæ ¼å¼ï¼š
æ—¶é—´æˆ³ [æ•°æ®åº“ç¼–å· å®¢æˆ·ç«¯åœ°å€:ç«¯å£] "å‘½ä»¤" "å‚æ•°1" "å‚æ•°2" ...
```

**å®é™…è¾“å‡ºç¤ºä¾‹**
```bash
OK
1629360001.123456 [0 127.0.0.1:52816] "ping"
1629360005.987654 [0 127.0.0.1:52816] "set" "name" "john"
1629360010.456789 [0 127.0.0.1:52816] "get" "name"
1629360015.321098 [0 127.0.0.1:52816] "hset" "user:1" "age" "25"
```

### 4.3 MONITORçš„æ€§èƒ½å½±å“


**âš ï¸ é‡è¦è­¦å‘Šï¼šMONITORå½±å“æ€§èƒ½**
```
æ€§èƒ½å½±å“åˆ†æï¼š
1. CPUå¼€é”€ï¼šæ¯ä¸ªå‘½ä»¤éƒ½éœ€è¦æ ¼å¼åŒ–è¾“å‡º
2. ç½‘ç»œå¼€é”€ï¼šéœ€è¦å‘é€ç›‘æ§æ•°æ®ç»™å®¢æˆ·ç«¯
3. å†…å­˜å¼€é”€ï¼šç»´æŠ¤ç›‘æ§å®¢æˆ·ç«¯çš„è¾“å‡ºç¼“å†²åŒº

å½±å“ç¨‹åº¦ï¼š
è½»é‡è´Ÿè½½ï¼šå½±å“è¾ƒå°ï¼ˆ5-10%æ€§èƒ½ä¸‹é™ï¼‰
é«˜å¹¶å‘ï¼šä¸¥é‡å½±å“ï¼ˆ30-50%æ€§èƒ½ä¸‹é™ï¼‰
```

**ğŸ’¡ å®‰å…¨ä½¿ç”¨å»ºè®®**
- **è°ƒè¯•æ—¶ä½¿ç”¨**ï¼šä»…åœ¨é—®é¢˜æ’æŸ¥æ—¶ä¸´æ—¶å¼€å¯
- **é¿å…ç”Ÿäº§ç¯å¢ƒé•¿æœŸå¼€å¯**ï¼šä¼šæ˜¾è‘—å½±å“æ€§èƒ½
- **ä½¿ç”¨ååŠæ—¶å…³é—­**ï¼šæŒ‰Ctrl+Cé€€å‡ºç›‘æ§
- **è€ƒè™‘ä½¿ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—**ï¼šå¯¹æ€§èƒ½å½±å“æ›´å°

### 4.4 MONITORå®é™…åº”ç”¨


**é—®é¢˜è¯Šæ–­åœºæ™¯**
```bash
# åœºæ™¯1ï¼šæ’æŸ¥å¼‚å¸¸å‘½ä»¤
redis-cli MONITOR | grep "FLUSHALL"

# åœºæ™¯2ï¼šåˆ†æè®¿é—®æ¨¡å¼  
redis-cli MONITOR | grep "user:"

# åœºæ™¯3ï¼šç»Ÿè®¡å‘½ä»¤é¢‘ç‡
redis-cli MONITOR | awk '{print $4}' | sort | uniq -c
```

**ç›‘æ§è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# ç›‘æ§Rediså‘½ä»¤å¹¶ä¿å­˜åˆ°æ–‡ä»¶
redis-cli MONITOR > redis-monitor-$(date +%Y%m%d-%H%M%S).log &
MONITOR_PID=$!

# è¿è¡Œ10åˆ†é’Ÿåè‡ªåŠ¨åœæ­¢
sleep 600
kill $MONITOR_PID

echo "ç›‘æ§å®Œæˆï¼Œæ—¥å¿—å·²ä¿å­˜"
```

---

## 5. ğŸ“Š INFOå‘½ä»¤è¯¦è§£


### 5.1 INFOå‘½ä»¤åŸºæœ¬ç”¨æ³•


**åŸºæœ¬æ¦‚å¿µ**
INFOå‘½ä»¤ç”¨äºè·å–RedisæœåŠ¡å™¨çš„å„ç§ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®ï¼Œæ˜¯æ€§èƒ½åˆ†æå’Œé—®é¢˜è¯Šæ–­çš„é‡è¦å·¥å…·ã€‚

```bash
# æŸ¥çœ‹æ‰€æœ‰ä¿¡æ¯
INFO

# æŸ¥çœ‹ç‰¹å®šåˆ†ç±»ä¿¡æ¯
INFO server        # æœåŠ¡å™¨ä¿¡æ¯
INFO memory        # å†…å­˜ä¿¡æ¯  
INFO stats         # ç»Ÿè®¡ä¿¡æ¯
INFO replication   # å¤åˆ¶ä¿¡æ¯
INFO cpu           # CPUä¿¡æ¯
```

### 5.2 é‡è¦ä¿¡æ¯åˆ†ç±»è¯¦è§£


#### ğŸ“ˆ å†…å­˜ä¿¡æ¯ (INFO memory)


**å…³é”®æŒ‡æ ‡è§£è¯»**
```bash
INFO memory

# é‡è¦æŒ‡æ ‡ï¼š
used_memory:838860800              # Redisä½¿ç”¨çš„å†…å­˜æ€»é‡
used_memory_human:800.00M          # äººç±»å¯è¯»æ ¼å¼
used_memory_rss:1055916032         # ç³»ç»Ÿå®é™…åˆ†é…å†…å­˜
used_memory_peak:1234567890        # å†…å­˜ä½¿ç”¨å³°å€¼
maxmemory:2147483648              # æœ€å¤§å†…å­˜é™åˆ¶
maxmemory_human:2.00G             # æœ€å¤§å†…å­˜é™åˆ¶ï¼ˆå¯è¯»ï¼‰
maxmemory_policy:allkeys-lru      # å†…å­˜æ·˜æ±°ç­–ç•¥
```

**ğŸ’¡ å†…å­˜æŒ‡æ ‡å«ä¹‰**
- **used_memory**ï¼šRedisçœŸæ­£ä½¿ç”¨çš„å†…å­˜
- **used_memory_rss**ï¼šæ“ä½œç³»ç»Ÿåˆ†é…ç»™Redisçš„å†…å­˜
- **å†…å­˜ç¢ç‰‡ç‡**ï¼šused_memory_rss / used_memoryï¼Œæ­£å¸¸å€¼1.0-1.5

#### ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ (INFO stats)


**å…³é”®æ€§èƒ½æŒ‡æ ‡**
```bash
INFO stats

# é‡è¦æŒ‡æ ‡ï¼š
total_connections_received:1234    # æ€»è¿æ¥æ•°
total_commands_processed:5678      # æ€»å‘½ä»¤æ•°
instantaneous_ops_per_sec:100     # å½“å‰QPS
hit_rate:95.5                     # ç¼“å­˜å‘½ä¸­ç‡
keyspace_hits:950000              # å‘½ä¸­æ¬¡æ•°
keyspace_misses:50000             # æœªå‘½ä¸­æ¬¡æ•°
expired_keys:12345                # è¿‡æœŸkeyæ•°é‡
evicted_keys:678                  # è¢«æ·˜æ±°keyæ•°é‡
```

#### ğŸ”„ å¤åˆ¶ä¿¡æ¯ (INFO replication)


**ä¸»ä»çŠ¶æ€ç›‘æ§**
```bash
INFO replication

# ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼š
role:master                        # è§’è‰²ï¼šä¸»èŠ‚ç‚¹
connected_slaves:2                 # è¿æ¥çš„ä»èŠ‚ç‚¹æ•°
slave0:ip=192.168.1.10,port=6379  # ä»èŠ‚ç‚¹1ä¿¡æ¯
slave1:ip=192.168.1.11,port=6379  # ä»èŠ‚ç‚¹2ä¿¡æ¯

# ä»èŠ‚ç‚¹ä¿¡æ¯ï¼š
role:slave                         # è§’è‰²ï¼šä»èŠ‚ç‚¹
master_host:192.168.1.100         # ä¸»èŠ‚ç‚¹åœ°å€
master_port:6379                  # ä¸»èŠ‚ç‚¹ç«¯å£
master_link_status:up             # è¿æ¥çŠ¶æ€
master_sync_in_progress:0         # æ˜¯å¦æ­£åœ¨åŒæ­¥
```

### 5.3 æ€§èƒ½ç›‘æ§é‡ç‚¹æŒ‡æ ‡


**ğŸ¯ å…³é”®æ€§èƒ½æŒ‡æ ‡**

| æŒ‡æ ‡ç±»åˆ« | **å…³é”®æŒ‡æ ‡** | **æ­£å¸¸èŒƒå›´** | **å¼‚å¸¸å‘Šè­¦** |
|---------|-------------|-------------|-------------|
| ğŸ’¾ **å†…å­˜** | å†…å­˜ä½¿ç”¨ç‡ | < 80% | > 90% |
| âš¡ **æ€§èƒ½** | QPS | æ ¹æ®ä¸šåŠ¡ | çªç„¶ä¸‹é™50% |
| ğŸ¯ **å‘½ä¸­ç‡** | ç¼“å­˜å‘½ä¸­ç‡ | > 90% | < 80% |
| ğŸ”— **è¿æ¥** | å½“å‰è¿æ¥æ•° | < æœ€å¤§è¿æ¥*0.8 | > æœ€å¤§è¿æ¥*0.9 |
| â±ï¸ **å»¶è¿Ÿ** | å¹³å‡å“åº”æ—¶é—´ | < 1ms | > 10ms |

### 5.4 INFOå‘½ä»¤æ€§èƒ½ç›‘æ§è„šæœ¬


**ç›‘æ§è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# Redisæ€§èƒ½ç›‘æ§è„šæœ¬

echo "=== Redisæ€§èƒ½ç›‘æ§æŠ¥å‘Š ==="
echo "æ—¶é—´: $(date)"
echo

# 1. å†…å­˜ä½¿ç”¨æƒ…å†µ
echo "ğŸ“Š å†…å­˜ä½¿ç”¨æƒ…å†µï¼š"
redis-cli INFO memory | grep -E "(used_memory_human|maxmemory_human|maxmemory_policy)"

# 2. å½“å‰æ€§èƒ½æŒ‡æ ‡
echo -e "\nâš¡ æ€§èƒ½æŒ‡æ ‡ï¼š"  
redis-cli INFO stats | grep -E "(instantaneous_ops_per_sec|keyspace_hits|keyspace_misses)"

# 3. è¿æ¥æƒ…å†µ
echo -e "\nğŸ”— è¿æ¥æƒ…å†µï¼š"
redis-cli INFO clients | grep "connected_clients"

# 4. æŒä¹…åŒ–çŠ¶æ€
echo -e "\nğŸ’¾ æŒä¹…åŒ–çŠ¶æ€ï¼š"
redis-cli INFO persistence | grep -E "(rdb_last_save_time|aof_enabled)"

echo -e "\n=== ç›‘æ§å®Œæˆ ==="
```

### 5.5 åŸºäºINFOçš„å‘Šè­¦æœºåˆ¶


**è‡ªåŠ¨å‘Šè­¦è„šæœ¬**
```python
import redis
import time
import smtplib

def check_redis_health():
    r = redis.Redis(host='localhost', port=6379)
    info = r.info()
    
    alerts = []
    
    # æ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡
    memory_usage = info['used_memory'] / info['maxmemory'] * 100
    if memory_usage > 90:
        alerts.append(f"å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: {memory_usage:.1f}%")
    
    # æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
    hits = info['keyspace_hits']
    misses = info['keyspace_misses']
    if hits + misses > 0:
        hit_rate = hits / (hits + misses) * 100
        if hit_rate < 80:
            alerts.append(f"ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½: {hit_rate:.1f}%")
    
    # æ£€æŸ¥è¿æ¥æ•°
    if info['connected_clients'] > 1000:
        alerts.append(f"è¿æ¥æ•°è¿‡å¤š: {info['connected_clients']}")
    
    return alerts

# ä½¿ç”¨ç¤ºä¾‹
while True:
    alerts = check_redis_health()
    if alerts:
        print("ğŸš¨ Rediså‘Šè­¦:")
        for alert in alerts:
            print(f"  - {alert}")
        # è¿™é‡Œå¯ä»¥å‘é€é‚®ä»¶æˆ–çŸ­ä¿¡é€šçŸ¥
    
    time.sleep(60)  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ…¢æŸ¥è¯¢ï¼šæ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„å‘½ä»¤ï¼Œä¼šé˜»å¡Rediså•çº¿ç¨‹
ğŸ”¸ å†…å­˜æ»¡ï¼šè§¦å‘æ·˜æ±°ç­–ç•¥æˆ–æ‹’ç»å†™å…¥ï¼Œå½±å“æœåŠ¡å¯ç”¨æ€§  
ğŸ”¸ é˜»å¡å‘½ä»¤ï¼šç­‰å¾…æ•°æ®çš„å‘½ä»¤ï¼Œå¯èƒ½å¯¼è‡´è¿æ¥å †ç§¯
ğŸ”¸ MONITORï¼šå®æ—¶ç›‘æ§å·¥å…·ï¼Œä½†ä¼šå½±å“æ€§èƒ½
ğŸ”¸ INFOï¼šè·å–RedisçŠ¶æ€ä¿¡æ¯ï¼Œæ€§èƒ½è¯Šæ–­çš„é‡è¦å·¥å…·
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ…¢æŸ¥è¯¢çš„æœ¬è´¨å½±å“**
```
å•çº¿ç¨‹æ¨¡å‹çš„å½±å“ï¼š
ä¸€ä¸ªæ…¢æŸ¥è¯¢ â†’ é˜»å¡æ•´ä¸ªRedis â†’ æ‰€æœ‰å®¢æˆ·ç«¯ç­‰å¾…

è§£å†³æ€è·¯ï¼š
é¢„é˜²ä¸ºä¸»ï¼šé¿å…ä½¿ç”¨å±é™©å‘½ä»¤
ç›‘æ§ä¸ºè¾…ï¼šåŠæ—¶å‘ç°æ…¢æŸ¥è¯¢
ä¼˜åŒ–æ›¿ä»£ï¼šä½¿ç”¨æ›´é«˜æ•ˆçš„å‘½ä»¤
```

**ğŸ”¹ å†…å­˜ç®¡ç†çš„å¹³è¡¡**
```
å†…å­˜ä½¿ç”¨çš„çŸ›ç›¾ï¼š
éœ€è¦è¶³å¤Ÿå†…å­˜ â†â†’ ç³»ç»Ÿèµ„æºæœ‰é™
æ•°æ®ä¸èƒ½ä¸¢å¤± â†â†’ å†…å­˜å¯èƒ½ä¸å¤Ÿ

è§£å†³ç­–ç•¥ï¼š
åˆç†é…ç½® + ç›‘æ§é¢„è­¦ + æ·˜æ±°ç­–ç•¥ + å®¹é‡è§„åˆ’
```

**ğŸ”¹ é˜»å¡å‘½ä»¤çš„åˆç†ä½¿ç”¨**
```
é˜»å¡çš„å¥½å¤„ï¼š
å‡å°‘å®¢æˆ·ç«¯è½®è¯¢ â†’ é™ä½CPUå’Œç½‘ç»œå¼€é”€
å®æ—¶å“åº” â†’ æå‡ç”¨æˆ·ä½“éªŒ

æ½œåœ¨é£é™©ï¼š
è¿æ¥å ç”¨ â†’ å¯èƒ½è€—å°½è¿æ¥æ± 
èµ„æºæ¶ˆè€— â†’ å¤§é‡é˜»å¡å®¢æˆ·ç«¯å½±å“æ€§èƒ½

ä½¿ç”¨åŸåˆ™ï¼š
è®¾ç½®åˆç†è¶…æ—¶ + æ§åˆ¶å¹¶å‘æ•° + ç›‘æ§èµ„æºä½¿ç”¨
```

### 6.3 æ€§èƒ½ä¼˜åŒ–å®æˆ˜æŒ‡å—


**ğŸ“‹ æ€§èƒ½é—®é¢˜æ’æŸ¥æ¸…å•**
```
ğŸ” å‘ç°æ€§èƒ½é—®é¢˜æ—¶çš„æ’æŸ¥æ­¥éª¤ï¼š
â–¡ 1. æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šSLOWLOG GET 10
â–¡ 2. æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µï¼šINFO memory  
â–¡ 3. åˆ†æå®¢æˆ·ç«¯è¿æ¥ï¼šINFO clients
â–¡ 4. æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡ï¼šINFO stats
â–¡ 5. ç›‘æ§å®æ—¶å‘½ä»¤ï¼šMONITORï¼ˆçŸ­æ—¶é—´ï¼‰
â–¡ 6. æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½ï¼štopã€htop
â–¡ 7. åˆ†æç½‘ç»œå»¶è¿Ÿï¼špingæµ‹è¯•
```

**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```
é¢„é˜²æ€§æªæ–½ï¼š
â€¢ è®¾ç½®æ…¢æŸ¥è¯¢ç›‘æ§å’Œå‘Šè­¦
â€¢ é…ç½®åˆç†çš„å†…å­˜æ·˜æ±°ç­–ç•¥  
â€¢ é¿å…ä½¿ç”¨å±é™©çš„å…¨é‡æ‰«æå‘½ä»¤
â€¢ å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
â€¢ ç›‘æ§å†…å­˜å’Œè¿æ¥æ•°å˜åŒ–è¶‹åŠ¿

åº”æ€¥å¤„ç†ï¼š
â€¢ æ…¢æŸ¥è¯¢ï¼šç«‹å³åœæ­¢å±é™©å‘½ä»¤ï¼Œä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ
â€¢ å†…å­˜æ»¡ï¼šä¸´æ—¶å¢åŠ å†…å­˜é™åˆ¶ï¼Œæ¸…ç†å¤§key
â€¢ é˜»å¡å †ç§¯ï¼šæ£€æŸ¥é˜»å¡å®¢æˆ·ç«¯ï¼Œè°ƒæ•´è¶…æ—¶è®¾ç½®
â€¢ è¿æ¥è€—å°½ï¼šé‡å¯åº”ç”¨é‡Šæ”¾è¿æ¥ï¼Œå¢åŠ è¿æ¥æ± 
```

### 6.4 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


```
ç›‘æ§ç­–ç•¥ï¼š
âœ… æŒç»­ç›‘æ§ï¼šæ…¢æŸ¥è¯¢ã€å†…å­˜ä½¿ç”¨ã€ç¼“å­˜å‘½ä¸­ç‡
âœ… å®šæœŸæ£€æŸ¥ï¼šæ¯å‘¨åˆ†æINFOæŠ¥å‘Šï¼Œå‘ç°è¶‹åŠ¿
âœ… è‡ªåŠ¨å‘Šè­¦ï¼šå†…å­˜>90%ã€å‘½ä¸­ç‡<80%ã€è¿æ¥æ•°å¼‚å¸¸
âœ… æ—¥å¿—ä¿ç•™ï¼šä¿å­˜å…³é”®æ—¶æœŸçš„ç›‘æ§æ•°æ®

è¿ç»´è§„èŒƒï¼š  
âœ… ç¦ç”¨å‘½ä»¤ï¼šKEYSã€FLUSHALLç­‰å±é™©å‘½ä»¤
âœ… èµ„æºè§„åˆ’ï¼šé¢„ç•™è¶³å¤Ÿå†…å­˜å’Œè¿æ¥æ•°
âœ… å¤‡ä»½ç­–ç•¥ï¼šå®šæœŸå¤‡ä»½ï¼Œé¿å…æ•°æ®ä¸¢å¤±
âœ… åº”æ€¥é¢„æ¡ˆï¼šå‡†å¤‡æ‰©å®¹å’Œæ•…éšœè½¬ç§»æ–¹æ¡ˆ
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æ…¢æŸ¥è¯¢æ‰¾SLOWLOGï¼Œé˜»å¡å…¨ç«™è¦é¿å…
- å†…å­˜æ»¡äº†è®¾æ·˜æ±°ï¼Œç›‘æ§å‘Šè­¦ä¸èƒ½å°‘  
- MONITORè™½å¥½å½±å“å¤§ï¼ŒINFOè¯Šæ–­æ˜¯é¦–é€‰
- é¢„é˜²ä¸ºä¸»ç›‘æ§è·Ÿï¼Œé—®é¢˜æ’æŸ¥æœ‰æ­¥éª¤