---
title: 9ã€Rediså¸¸ç”¨å‘½ä»¤æ“ä½œè¯¦è§£
---
## ğŸ“š ç›®å½•

1. [Redisé€šç”¨é”®æ“ä½œæ¦‚è¿°](#1-Redisé€šç”¨é”®æ“ä½œæ¦‚è¿°)
2. [é”®æ“ä½œåŸºç¡€å‘½ä»¤è¯¦è§£](#2-é”®æ“ä½œåŸºç¡€å‘½ä»¤è¯¦è§£)
3. [é”®æŸ¥æ‰¾ä¸éå†å‘½ä»¤](#3-é”®æŸ¥æ‰¾ä¸éå†å‘½ä»¤)
4. [é”®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†](#4-é”®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†)
5. [æ•°æ®åº“æ¸…ç©ºæ“ä½œ](#5-æ•°æ®åº“æ¸…ç©ºæ“ä½œ)
6. [ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ³¨æ„äº‹é¡¹](#6-ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ³¨æ„äº‹é¡¹)
7. [å‘½ä»¤ä½¿ç”¨æœ€ä½³å®è·µ](#7-å‘½ä»¤ä½¿ç”¨æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Redisé€šç”¨é”®æ“ä½œæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Redisé”®æ“ä½œï¼Ÿ


**ç®€å•ç†è§£**ï¼šé”®æ“ä½œå°±æ˜¯å¯¹Redisä¸­çš„**é”®å**è¿›è¡Œå„ç§ç®¡ç†æ“ä½œ

```
æƒ³è±¡Redisæ˜¯ä¸€ä¸ªå·¨å¤§çš„å‚¨ç‰©æŸœï¼š
å‚¨ç‰©æŸœç¼–å· = é”®(key)
å‚¨ç‰©æŸœå†…å®¹ = å€¼(value)

é”®æ“ä½œ = ç®¡ç†å‚¨ç‰©æŸœç¼–å·çš„æ“ä½œï¼š
- æŸ¥çœ‹æœ‰å“ªäº›ç¼–å·ï¼ˆKEYSï¼‰
- æ£€æŸ¥ç¼–å·æ˜¯å¦å­˜åœ¨ï¼ˆEXISTSï¼‰
- åˆ é™¤æŸä¸ªå‚¨ç‰©æŸœï¼ˆDELï¼‰
- ç»™å‚¨ç‰©æŸœæ”¹ç¼–å·ï¼ˆRENAMEï¼‰
```

### 1.2 é”®æ“ä½œçš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆè¦å­¦é”®æ“ä½œï¼Ÿ**
- **æ•°æ®ç®¡ç†**ï¼šç®¡ç†Redisä¸­å­˜å‚¨çš„æ‰€æœ‰æ•°æ®
- **è¿ç»´ç»´æŠ¤**ï¼šæ¸…ç†è¿‡æœŸæ•°æ®ã€é‡Šæ”¾å†…å­˜
- **é—®é¢˜æ’æŸ¥**ï¼šæŸ¥æ‰¾ç‰¹å®šæ•°æ®ã€åˆ†ææ•°æ®åˆ†å¸ƒ
- **å®‰å…¨æ“ä½œ**ï¼šé¿å…è¯¯åˆ é‡è¦æ•°æ®

### 1.3 é”®æ“ä½œå‘½ä»¤åˆ†ç±»


```
é”®æ“ä½œå‘½ä»¤å®¶æ—ï¼š

åŸºç¡€æ“ä½œï¼š
â”œâ”€â”€ EXISTS    # æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
â”œâ”€â”€ DEL       # åˆ é™¤é”®
â”œâ”€â”€ TYPE      # æŸ¥çœ‹é”®çš„æ•°æ®ç±»å‹
â””â”€â”€ RENAME    # é‡å‘½åé”®

æŸ¥æ‰¾éå†ï¼š
â”œâ”€â”€ KEYS      # æŸ¥æ‰¾é”®ï¼ˆå±é™©å‘½ä»¤ï¼‰
â””â”€â”€ SCAN      # å®‰å…¨éå†é”®

ç”Ÿå‘½å‘¨æœŸï¼š
â”œâ”€â”€ EXPIRE    # è®¾ç½®è¿‡æœŸæ—¶é—´
â””â”€â”€ TTL       # æŸ¥çœ‹å‰©ä½™ç”Ÿå­˜æ—¶é—´

æ‰¹é‡æ“ä½œï¼š
â”œâ”€â”€ FLUSHDB   # æ¸…ç©ºå½“å‰æ•°æ®åº“
â””â”€â”€ FLUSHALL  # æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“
```

---

## 2. ğŸ”§ é”®æ“ä½œåŸºç¡€å‘½ä»¤è¯¦è§£


### 2.1 æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ï¼šEXISTS


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
EXISTS key [key ...]
```

**ğŸ’¡ åŠŸèƒ½è¯´æ˜**
- æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ˜¯å¦å­˜åœ¨
- è¿”å›å­˜åœ¨çš„é”®çš„æ•°é‡
- ä¸å­˜åœ¨è¿”å›0ï¼Œå­˜åœ¨è¿”å›å¯¹åº”æ•°é‡

**ğŸ”¸ ä½¿ç”¨ç¤ºä¾‹**
```bash
# æ£€æŸ¥å•ä¸ªé”®
EXISTS user:1001
# è¿”å›ï¼š1ï¼ˆå­˜åœ¨ï¼‰æˆ– 0ï¼ˆä¸å­˜åœ¨ï¼‰

# æ£€æŸ¥å¤šä¸ªé”®
EXISTS user:1001 user:1002 user:1003
# è¿”å›ï¼š2ï¼ˆè¡¨ç¤º3ä¸ªé”®ä¸­æœ‰2ä¸ªå­˜åœ¨ï¼‰

# å®é™…åº”ç”¨ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
if redis-cli EXISTS user:$userid > /dev/null; then
    echo "ç”¨æˆ·å­˜åœ¨"
else
    echo "ç”¨æˆ·ä¸å­˜åœ¨"
fi
```

**âš¡ å®é™…åº”ç”¨åœºæ™¯**
```bash
# ç¼“å­˜å‡»ç©¿é˜²æŠ¤
user_id="1001"
if [ $(redis-cli EXISTS user:cache:$user_id) -eq 1 ]; then
    # ä»ç¼“å­˜è·å–æ•°æ®
    user_data=$(redis-cli GET user:cache:$user_id)
else
    # ä»æ•°æ®åº“è·å–æ•°æ®å¹¶ç¼“å­˜
    user_data=$(fetch_from_database $user_id)
    redis-cli SET user:cache:$user_id "$user_data"
fi
```

### 2.2 åˆ é™¤é”®ï¼šDEL


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
DEL key [key ...]
```

**ğŸ’¡ åŠŸèƒ½è¯´æ˜**
- åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé”®åŠå…¶å¯¹åº”çš„å€¼
- è¿”å›å®é™…åˆ é™¤çš„é”®æ•°é‡
- åˆ é™¤ä¸å­˜åœ¨çš„é”®ä¸ä¼šæŠ¥é”™

**ğŸ”¸ ä½¿ç”¨ç¤ºä¾‹**
```bash
# åˆ é™¤å•ä¸ªé”®
DEL user:1001
# è¿”å›ï¼š1ï¼ˆæˆåŠŸåˆ é™¤ï¼‰æˆ– 0ï¼ˆé”®ä¸å­˜åœ¨ï¼‰

# åˆ é™¤å¤šä¸ªé”®
DEL user:1001 user:1002 session:abc123
# è¿”å›ï¼š2ï¼ˆè¡¨ç¤ºåˆ é™¤äº†2ä¸ªé”®ï¼‰

# åˆ é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜
DEL user:cache:1001 user:cache:1002 user:cache:1003
```

**âš ï¸ åˆ é™¤æ³¨æ„äº‹é¡¹**
```bash
# åˆ é™¤å‰å…ˆæ£€æŸ¥
redis-cli EXISTS important:data
if [ $? -eq 1 ]; then
    echo "ç¡®è®¤è¦åˆ é™¤é‡è¦æ•°æ®å—ï¼Ÿ(y/n)"
    read confirm
    if [ "$confirm" = "y" ]; then
        redis-cli DEL important:data
    fi
fi

# æ‰¹é‡åˆ é™¤æ—¶è¦å°å¿ƒ
# âŒ å±é™©ï¼šå¯èƒ½åˆ é™¤é‡è¦æ•°æ®
redis-cli DEL user:*

# âœ… å®‰å…¨ï¼šé€ä¸ªç¡®è®¤åˆ é™¤
for key in $(redis-cli KEYS user:temp:*); do
    redis-cli DEL $key
done
```

### 2.3 æŸ¥çœ‹é”®ç±»å‹ï¼šTYPE


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
TYPE key
```

**ğŸ’¡ åŠŸèƒ½è¯´æ˜**
- æŸ¥çœ‹é”®å­˜å‚¨çš„æ•°æ®ç±»å‹
- è¿”å›å€¼ï¼šstringã€listã€setã€zsetã€hashã€none

**ğŸ”¸ ä½¿ç”¨ç¤ºä¾‹**
```bash
# æŸ¥çœ‹é”®ç±»å‹
TYPE user:1001:profile
# è¿”å›ï¼šhash

TYPE user:1001:scores  
# è¿”å›ï¼šzset

TYPE user:1001:friends
# è¿”å›ï¼šset

TYPE nonexistent:key
# è¿”å›ï¼šnone
```

**ğŸ“Š ç±»å‹å¯¹åº”å…³ç³»**
| Redisç±»å‹ | **TYPEè¿”å›å€¼** | **è¯´æ˜** |
|----------|---------------|---------|
| å­—ç¬¦ä¸² | `string` | æ™®é€šå­—ç¬¦ä¸²ã€æ•°å­— |
| åˆ—è¡¨ | `list` | æœ‰åºå¯é‡å¤é›†åˆ |
| é›†åˆ | `set` | æ— åºä¸é‡å¤é›†åˆ |
| æœ‰åºé›†åˆ | `zset` | æœ‰åºä¸é‡å¤é›†åˆ |
| å“ˆå¸Œ | `hash` | é”®å€¼å¯¹é›†åˆ |
| ä¸å­˜åœ¨ | `none` | é”®ä¸å­˜åœ¨ |

**ğŸ”§ å®é™…åº”ç”¨**
```bash
# æ ¹æ®ç±»å‹è¿›è¡Œä¸åŒæ“ä½œ
key_type=$(redis-cli TYPE user:data)

case $key_type in
    "hash")
        redis-cli HGETALL user:data
        ;;
    "list")
        redis-cli LRANGE user:data 0 -1
        ;;
    "set")
        redis-cli SMEMBERS user:data
        ;;
    "zset")
        redis-cli ZRANGE user:data 0 -1 WITHSCORES
        ;;
    "string")
        redis-cli GET user:data
        ;;
    *)
        echo "é”®ä¸å­˜åœ¨æˆ–ç±»å‹æœªçŸ¥"
        ;;
esac
```

### 2.4 é‡å‘½åé”®ï¼šRENAME


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
RENAME oldkey newkey
```

**ğŸ’¡ åŠŸèƒ½è¯´æ˜**
- å°†é”®ä»æ—§åç§°é‡å‘½åä¸ºæ–°åç§°
- å¦‚æœæ–°é”®åå·²å­˜åœ¨ï¼Œä¼šè¢«è¦†ç›–
- å¦‚æœæ—§é”®ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯

**ğŸ”¸ ä½¿ç”¨ç¤ºä¾‹**
```bash
# åŸºæœ¬é‡å‘½å
RENAME user:temp:1001 user:1001
# è¿”å›ï¼šOK

# é‡å‘½åå¯èƒ½è¦†ç›–å·²æœ‰é”®
RENAME user:backup user:main
# è­¦å‘Šï¼šå¦‚æœuser:mainå·²å­˜åœ¨ï¼Œä¼šè¢«è¦†ç›–ï¼
```

**ğŸ”’ å®‰å…¨é‡å‘½åï¼šRENAMENX**
```bash
# å®‰å…¨é‡å‘½åï¼ˆç›®æ ‡é”®ä¸å­˜åœ¨æ—¶æ‰é‡å‘½åï¼‰
RENAMENX user:temp:1001 user:1001
# è¿”å›ï¼š1ï¼ˆæˆåŠŸï¼‰æˆ– 0ï¼ˆç›®æ ‡é”®å·²å­˜åœ¨ï¼Œæœªé‡å‘½åï¼‰

# å®é™…åº”ç”¨ï¼šå®‰å…¨çš„æ•°æ®è¿ç§»
if [ $(redis-cli RENAMENX temp:data final:data) -eq 1 ]; then
    echo "æ•°æ®è¿ç§»æˆåŠŸ"
else
    echo "ç›®æ ‡é”®å·²å­˜åœ¨ï¼Œè¿ç§»å¤±è´¥"
    # å¯ä»¥é€‰æ‹©å…¶ä»–å¤„ç†æ–¹å¼
fi
```

---

## 3. ğŸ” é”®æŸ¥æ‰¾ä¸éå†å‘½ä»¤


### 3.1 å±é™©å‘½ä»¤ï¼šKEYS


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
KEYS pattern
```

**âš ï¸ é‡è¦è­¦å‘Š**
```
KEYSå‘½ä»¤çš„é—®é¢˜ï¼š
âŒ ä¼šé˜»å¡RedisæœåŠ¡å™¨
âŒ æ—¶é—´å¤æ‚åº¦O(N)ï¼ŒNä¸ºæ•°æ®åº“ä¸­é”®çš„æ•°é‡
âŒ ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨
âŒ 100ä¸‡ä¸ªé”®å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ‰èƒ½è¿”å›ç»“æœ
```

**ğŸ”¸ é€šé…ç¬¦è§„åˆ™**
```bash
# æ”¯æŒçš„é€šé…ç¬¦ï¼š
*   # åŒ¹é…ä»»æ„æ•°é‡çš„ä»»æ„å­—ç¬¦
?   # åŒ¹é…å•ä¸ªå­—ç¬¦  
[]  # åŒ¹é…æ‹¬å·å†…çš„ä»»ä¸€å­—ç¬¦
\   # è½¬ä¹‰å­—ç¬¦

# ä½¿ç”¨ç¤ºä¾‹ï¼š
KEYS user:*          # æ‰€æœ‰ä»¥user:å¼€å¤´çš„é”®
KEYS user:100?       # user:1001, user:1002ç­‰
KEYS user:[123]*     # ä»¥user:1ã€user:2ã€user:3å¼€å¤´çš„é”®
KEYS *session*       # åŒ…å«sessionçš„æ‰€æœ‰é”®
```

**âš ï¸ ä»€ä¹ˆæ—¶å€™å¯ä»¥ç”¨KEYS**
```bash
# âœ… å¯ä»¥ä½¿ç”¨çš„åœºæ™¯ï¼š
1. å¼€å‘ç¯å¢ƒè°ƒè¯•
2. æ•°æ®é‡å¾ˆå°ï¼ˆ<1000ä¸ªé”®ï¼‰
3. ç¦»çº¿æ•°æ®åˆ†æ
4. Rediså®ä¾‹ä¸“é—¨ç”¨äºæµ‹è¯•

# âŒ ç»å¯¹ä¸èƒ½ä½¿ç”¨çš„åœºæ™¯ï¼š
1. ç”Ÿäº§ç¯å¢ƒçš„åœ¨çº¿æœåŠ¡
2. é«˜å¹¶å‘åº”ç”¨
3. æ•°æ®é‡å¤§çš„Rediså®ä¾‹
4. å¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨
```

### 3.2 å®‰å…¨å‘½ä»¤ï¼šSCAN


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
SCAN cursor [MATCH pattern] [COUNT count]
```

**ğŸ’¡ SCANçš„ä¼˜åŠ¿**
```
SCAN vs KEYSçš„åŒºåˆ«ï¼š
âœ… SCANï¼šæ¸è¿›å¼éå†ï¼Œä¸ä¼šé˜»å¡æœåŠ¡å™¨
âœ… æ¯æ¬¡åªè¿”å›å°‘é‡ç»“æœï¼Œå¯æ§åˆ¶å½±å“èŒƒå›´
âœ… é€‚åˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨
âœ… å¯ä»¥ä¸­æ–­ï¼Œä¸ä¼šå½±å“å…¶ä»–æ“ä½œ

âŒ KEYSï¼šä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰ç»“æœï¼Œå¯èƒ½é˜»å¡æœåŠ¡å™¨
```

**ğŸ”¸ SCANå·¥ä½œåŸç†**
```
SCANé‡‡ç”¨æ¸¸æ ‡æ–¹å¼éå†ï¼š

ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šSCAN 0
è¿”å›ï¼š["ä¸‹æ¬¡æ¸¸æ ‡", ["key1", "key2", "key3"]]

ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šSCAN ä¸‹æ¬¡æ¸¸æ ‡  
è¿”å›ï¼š["æ–°æ¸¸æ ‡", ["key4", "key5"]]

ç»§ç»­è°ƒç”¨ç›´åˆ°æ¸¸æ ‡è¿”å›0ï¼Œè¡¨ç¤ºéå†å®Œæˆ
```

**ğŸ”§ å®é™…ä½¿ç”¨ç¤ºä¾‹**
```bash
#!/bin/bash
# å®‰å…¨åœ°è·å–æ‰€æœ‰ç”¨æˆ·é”®

cursor=0
all_keys=()

while true; do
    # æ‰§è¡ŒSCANå‘½ä»¤
    result=$(redis-cli SCAN $cursor MATCH user:* COUNT 100)
    
    # è§£æç»“æœ
    cursor=$(echo "$result" | head -n 1)
    keys=$(echo "$result" | tail -n +2)
    
    # æ”¶é›†é”®
    if [ -n "$keys" ]; then
        all_keys+=($keys)
    fi
    
    # æ£€æŸ¥æ˜¯å¦éå†å®Œæˆ
    if [ "$cursor" -eq 0 ]; then
        break
    fi
done

echo "æ‰¾åˆ° ${#all_keys[@]} ä¸ªç”¨æˆ·é”®"
```

**âš¡ SCANå‚æ•°è¯´æ˜**
```bash
# COUNTå‚æ•°ï¼šå»ºè®®æ¯æ¬¡è¿”å›çš„å…ƒç´ æ•°é‡
SCAN 0 COUNT 10      # å»ºè®®è¿”å›10ä¸ªå…ƒç´ 
SCAN 0 COUNT 100     # å»ºè®®è¿”å›100ä¸ªå…ƒç´ 

# MATCHå‚æ•°ï¼šè¿‡æ»¤æ¨¡å¼
SCAN 0 MATCH user:*  # åªè¿”å›åŒ¹é…user:*çš„é”®
SCAN 0 MATCH *session* COUNT 50  # ç»„åˆä½¿ç”¨

# æ³¨æ„ï¼šCOUNTåªæ˜¯å»ºè®®å€¼ï¼Œå®é™…è¿”å›æ•°é‡å¯èƒ½ä¸åŒ
```

---

## 4. â° é”®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†


### 4.1 è®¾ç½®è¿‡æœŸæ—¶é—´ï¼šEXPIRE


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
EXPIRE key seconds     # è®¾ç½®ç§’çº§è¿‡æœŸæ—¶é—´
EXPIREAT key timestamp # è®¾ç½®åˆ°æŒ‡å®šæ—¶é—´æˆ³è¿‡æœŸ
PEXPIRE key milliseconds # è®¾ç½®æ¯«ç§’çº§è¿‡æœŸæ—¶é—´
```

**ğŸ’¡ è¿‡æœŸæ—¶é—´çš„ä½œç”¨**
```
ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Ÿ
ğŸ”¸ è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ•°æ®
ğŸ”¸ é˜²æ­¢å†…å­˜æ— é™å¢é•¿  
ğŸ”¸ å®ç°ç¼“å­˜æ·˜æ±°ç­–ç•¥
ğŸ”¸ æ¨¡æ‹Ÿæ•°æ®çš„ç”Ÿå‘½å‘¨æœŸ
```

**ğŸ”¸ ä½¿ç”¨ç¤ºä¾‹**
```bash
# è®¾ç½®ç”¨æˆ·session 1å°æ—¶åè¿‡æœŸ
EXPIRE session:user123 3600

# è®¾ç½®éªŒè¯ç 5åˆ†é’Ÿåè¿‡æœŸ
EXPIRE verify:phone:13800138000 300

# è®¾ç½®åˆ°æŒ‡å®šæ—¶é—´è¿‡æœŸï¼ˆæ—¶é—´æˆ³ï¼‰
EXPIREAT cache:data 1692000000

# è®¾ç½®æ¯«ç§’çº§è¿‡æœŸï¼ˆç²¾ç¡®æ§åˆ¶ï¼‰
PEXPIRE flash:message 5000  # 5ç§’åè¿‡æœŸ
```

**âš¡ å®é™…åº”ç”¨åœºæ™¯**
```bash
# ç”¨æˆ·ç™»å½•tokenç®¡ç†
user_token="abc123def456"
redis-cli SET token:$user_token "$user_id"
redis-cli EXPIRE token:$user_token 7200  # 2å°æ—¶åè¿‡æœŸ

# éªŒè¯ç ç³»ç»Ÿ
phone="13800138000"
code="123456"
redis-cli SET verify:$phone $code
redis-cli EXPIRE verify:$phone 300  # 5åˆ†é’Ÿåè¿‡æœŸ

# ç¼“å­˜æ•°æ®
cache_key="product:1001"
redis-cli SET $cache_key "$product_data"
redis-cli EXPIRE $cache_key 1800  # 30åˆ†é’Ÿåè¿‡æœŸ
```

### 4.2 æŸ¥çœ‹å‰©ä½™ç”Ÿå­˜æ—¶é—´ï¼šTTL


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
TTL key      # è¿”å›ç§’çº§å‰©ä½™æ—¶é—´
PTTL key     # è¿”å›æ¯«ç§’çº§å‰©ä½™æ—¶é—´
```

**ğŸ“Š TTLè¿”å›å€¼å«ä¹‰**
| è¿”å›å€¼ | **å«ä¹‰** |
|-------|---------|
| `æ­£æ•°` | å‰©ä½™è¿‡æœŸç§’æ•° |
| `-1` | é”®å­˜åœ¨ä½†æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ |
| `-2` | é”®ä¸å­˜åœ¨ |

**ğŸ”¸ ä½¿ç”¨ç¤ºä¾‹**
```bash
# æŸ¥çœ‹sessionå‰©ä½™æ—¶é—´
TTL session:user123
# è¿”å›ï¼š1800ï¼ˆè¿˜æœ‰30åˆ†é’Ÿï¼‰

# æŸ¥çœ‹éªŒè¯ç å‰©ä½™æ—¶é—´
TTL verify:phone:13800138000  
# è¿”å›ï¼š120ï¼ˆè¿˜æœ‰2åˆ†é’Ÿï¼‰

# æŸ¥çœ‹ä¸å­˜åœ¨çš„é”®
TTL nonexistent:key
# è¿”å›ï¼š-2ï¼ˆé”®ä¸å­˜åœ¨ï¼‰

# æŸ¥çœ‹æ°¸ä¹…é”®
TTL permanent:data
# è¿”å›ï¼š-1ï¼ˆæ°¸ä¸è¿‡æœŸï¼‰
```

**ğŸ”§ å®é™…åº”ç”¨**
```bash
# æ£€æŸ¥tokenæ˜¯å¦å³å°†è¿‡æœŸ
token_ttl=$(redis-cli TTL token:$user_token)

if [ $token_ttl -lt 600 ]; then  # å°äº10åˆ†é’Ÿ
    echo "Tokenå³å°†è¿‡æœŸï¼Œéœ€è¦åˆ·æ–°"
    # åˆ·æ–°token
    redis-cli EXPIRE token:$user_token 7200
elif [ $token_ttl -eq -2 ]; then
    echo "Tokenå·²è¿‡æœŸæˆ–ä¸å­˜åœ¨"
    # é‡æ–°ç™»å½•
else
    echo "Tokenæœ‰æ•ˆï¼Œå‰©ä½™${token_ttl}ç§’"
fi
```

---

## 5. ğŸ—‘ï¸ æ•°æ®åº“æ¸…ç©ºæ“ä½œ


### 5.1 æ¸…ç©ºå½“å‰æ•°æ®åº“ï¼šFLUSHDB


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
FLUSHDB [ASYNC]
```

**ğŸ’¡ åŠŸèƒ½è¯´æ˜**
- åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®
- ASYNCé€‰é¡¹è¡¨ç¤ºå¼‚æ­¥åˆ é™¤ï¼ˆæ¨èï¼‰
- åªå½±å“å½“å‰é€‰æ‹©çš„æ•°æ®åº“

**ğŸ”¸ æ•°æ®åº“ç¼–å·æ¦‚å¿µ**
```
Redisé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼ˆ0-15ï¼‰ï¼š

æ•°æ®åº“0ï¼šé»˜è®¤æ•°æ®åº“
æ•°æ®åº“1ï¼šå¯èƒ½ç”¨äºæµ‹è¯•
æ•°æ®åº“2ï¼šå¯èƒ½ç”¨äºç¼“å­˜
...
æ•°æ®åº“15ï¼šå…¶ä»–ç”¨é€”

åˆ‡æ¢æ•°æ®åº“ï¼šSELECT database_number
```

**âš ï¸ ä½¿ç”¨ç¤ºä¾‹**
```bash
# æ¸…ç©ºå½“å‰æ•°æ®åº“
FLUSHDB
# è¿”å›ï¼šOK

# å¼‚æ­¥æ¸…ç©ºï¼ˆæ¨èï¼‰
FLUSHDB ASYNC
# è¿”å›ï¼šOK

# å…ˆåˆ‡æ¢åˆ°æµ‹è¯•æ•°æ®åº“å†æ¸…ç©º
SELECT 1
FLUSHDB ASYNC
```

### 5.2 æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“ï¼šFLUSHALL


**ğŸ¯ åŸºç¡€è¯­æ³•**
```bash
FLUSHALL [ASYNC]
```

**ğŸ’¡ åŠŸèƒ½è¯´æ˜**
- åˆ é™¤Rediså®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰é”®
- è¿™æ˜¯æœ€å±é™©çš„å‘½ä»¤ä¹‹ä¸€
- ASYNCé€‰é¡¹å¼‚æ­¥æ‰§è¡Œï¼Œé¿å…é˜»å¡

**ğŸš¨ å±é™©è­¦å‘Š**
```
FLUSHALLæ˜¯æåº¦å±é™©çš„å‘½ä»¤ï¼š
âŒ ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼Œæ— æ³•æ¢å¤
âŒ å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºæ•°æ®ä¸¢å¤±
âŒ ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨éœ€è¦æå…¶è°¨æ…
âŒ å»ºè®®ç”Ÿäº§ç¯å¢ƒç¦ç”¨æ­¤å‘½ä»¤
```

**ğŸ”’ å®‰å…¨ä½¿ç”¨å»ºè®®**
```bash
# âœ… å¼€å‘ç¯å¢ƒé‡ç½®
echo "ç¡®è®¤è¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿè¾“å…¥YESç¡®è®¤ï¼š"
read confirm
if [ "$confirm" = "YES" ]; then
    redis-cli FLUSHALL ASYNC
    echo "å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®"
fi

# âœ… æµ‹è¯•ç¯å¢ƒæ¸…ç†
if [ "$ENVIRONMENT" = "test" ]; then
    redis-cli FLUSHALL ASYNC
    echo "æµ‹è¯•ç¯å¢ƒå·²é‡ç½®"
else
    echo "éæµ‹è¯•ç¯å¢ƒï¼Œæ‹’ç»æ‰§è¡ŒFLUSHALL"
fi
```

---

## 6. ğŸš¨ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ³¨æ„äº‹é¡¹


### 6.1 å‘½ä»¤é£é™©ç­‰çº§


**ğŸ”´ é«˜å±å‘½ä»¤ï¼ˆç”Ÿäº§ç¯å¢ƒç¦ç”¨ï¼‰**
```bash
KEYS *           # å¯èƒ½é˜»å¡æœåŠ¡å™¨
FLUSHALL         # åˆ é™¤æ‰€æœ‰æ•°æ®
FLUSHDB          # åˆ é™¤å½“å‰æ•°æ®åº“æ‰€æœ‰æ•°æ®
CONFIG SET       # ä¿®æ”¹æœåŠ¡å™¨é…ç½®
DEBUG            # è°ƒè¯•å‘½ä»¤
SHUTDOWN         # å…³é—­æœåŠ¡å™¨
```

**ğŸŸ¡ ä¸­ç­‰é£é™©å‘½ä»¤ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰**
```bash
DEL key1 key2... # æ‰¹é‡åˆ é™¤è¦ç¡®è®¤
RENAME           # å¯èƒ½è¦†ç›–é‡è¦æ•°æ®
SCAN             # å¤§é‡ä½¿ç”¨å¯èƒ½å½±å“æ€§èƒ½
```

**ğŸŸ¢ å®‰å…¨å‘½ä»¤ï¼ˆå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼‰**
```bash
EXISTS           # æ£€æŸ¥å­˜åœ¨æ€§
TYPE             # æŸ¥çœ‹ç±»å‹
TTL              # æŸ¥çœ‹è¿‡æœŸæ—¶é—´
GET/SET          # åŸºæœ¬è¯»å†™æ“ä½œ
```

### 6.2 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ”§ é…ç½®å®‰å…¨ç­–ç•¥**
```bash
# redis.confé…ç½®ç¤ºä¾‹
# ç¦ç”¨å±é™©å‘½ä»¤
rename-command FLUSHDB ""
rename-command FLUSHALL ""  
rename-command KEYS ""
rename-command CONFIG "REDIS_CONFIG_e8b3d91c"

# è®¾ç½®å¯†ç 
requirepass your_strong_password

# ç»‘å®šIPåœ°å€
bind 127.0.0.1 192.168.1.100
```

**ğŸ“Š ç›‘æ§å…³é”®æŒ‡æ ‡**
```bash
# ç›‘æ§è„šæœ¬ç¤ºä¾‹
#!/bin/bash

# æ£€æŸ¥è¿æ¥æ•°
connections=$(redis-cli INFO clients | grep connected_clients | cut -d: -f2)
echo "å½“å‰è¿æ¥æ•°ï¼š$connections"

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
memory=$(redis-cli INFO memory | grep used_memory_human | cut -d: -f2)
echo "å†…å­˜ä½¿ç”¨ï¼š$memory"

# æ£€æŸ¥æ…¢æŸ¥è¯¢
slow_queries=$(redis-cli SLOWLOG LEN)
echo "æ…¢æŸ¥è¯¢æ•°é‡ï¼š$slow_queries"

# å‘Šè­¦é˜ˆå€¼æ£€æŸ¥
if [ $connections -gt 1000 ]; then
    echo "è­¦å‘Šï¼šè¿æ¥æ•°è¿‡é«˜ï¼"
fi
```

---

## 7. ğŸ’¡ å‘½ä»¤ä½¿ç”¨æœ€ä½³å®è·µ


### 7.1 é”®åè®¾è®¡è§„èŒƒ


**ğŸ¯ é”®åå‘½åè§„èŒƒ**
```bash
# âœ… æ¨èçš„é”®åæ ¼å¼
ä¸šåŠ¡æ¨¡å—:æ•°æ®ç±»å‹:å”¯ä¸€æ ‡è¯†

# å®é™…ç¤ºä¾‹
user:profile:1001        # ç”¨æˆ·èµ„æ–™
user:session:abc123      # ç”¨æˆ·ä¼šè¯
product:cache:2001       # å•†å“ç¼“å­˜
order:list:user:1001     # ç”¨æˆ·è®¢å•åˆ—è¡¨
cache:api:user:detail    # APIç¼“å­˜

# âŒ ä¸æ¨èçš„é”®å
userProfile1001          # ä¸æ¸…æ™°
u_p_1001                # ç¼©å†™ä¸æ˜
user-profile-1001        # åˆ†éš”ç¬¦ä¸ç»Ÿä¸€
```

**ğŸ”¸ é”®åè®¾è®¡åŸåˆ™**
```
è®¾è®¡åŸåˆ™ï¼š
1. æœ‰æ„ä¹‰ï¼šè§åçŸ¥æ„
2. åˆ†å±‚æ¬¡ï¼šç”¨å†’å·åˆ†éš”å±‚çº§
3. æœ‰è§„å¾‹ï¼šåŒç±»æ•°æ®æ ¼å¼ä¸€è‡´
4. é€‚é•¿åº¦ï¼šä¸è¦å¤ªé•¿ä¹Ÿä¸è¦å¤ªçŸ­
5. é¿å†²çªï¼šä¸åŒä¸šåŠ¡ç”¨ä¸åŒå‰ç¼€
```

### 7.2 æ‰¹é‡æ“ä½œä¼˜åŒ–


**âš¡ æ‰¹é‡æ£€æŸ¥é”®å­˜åœ¨**
```bash
# âŒ ä½æ•ˆæ–¹å¼ï¼šå¾ªç¯å•ä¸ªæ£€æŸ¥
for user_id in {1001..1100}; do
    redis-cli EXISTS user:$user_id
done

# âœ… é«˜æ•ˆæ–¹å¼ï¼šæ‰¹é‡æ£€æŸ¥
redis-cli EXISTS user:1001 user:1002 user:1003 # ...
```

**ğŸ”§ å®‰å…¨æ‰¹é‡åˆ é™¤**
```bash
#!/bin/bash
# å®‰å…¨åˆ é™¤ä¸´æ—¶æ•°æ®

echo "å¼€å§‹æ¸…ç†ä¸´æ—¶æ•°æ®..."
cursor=0
deleted_count=0

while true; do
    # ä½¿ç”¨SCANæŸ¥æ‰¾ä¸´æ—¶é”®
    result=$(redis-cli SCAN $cursor MATCH temp:* COUNT 100)
    cursor=$(echo "$result" | head -n 1)
    keys=$(echo "$result" | tail -n +2 | tr '\n' ' ')
    
    # æ‰¹é‡åˆ é™¤æ‰¾åˆ°çš„é”®
    if [ -n "$keys" ]; then
        deleted=$(redis-cli DEL $keys)
        deleted_count=$((deleted_count + deleted))
        echo "åˆ é™¤äº† $deleted ä¸ªä¸´æ—¶é”®"
    fi
    
    # æ£€æŸ¥æ˜¯å¦å®Œæˆ
    if [ "$cursor" -eq 0 ]; then
        break
    fi
done

echo "æ€»å…±åˆ é™¤äº† $deleted_count ä¸ªä¸´æ—¶é”®"
```

### 7.3 è¿‡æœŸæ—¶é—´ç®¡ç†


**â° è¿‡æœŸæ—¶é—´ç­–ç•¥**
```bash
# ä¸åŒç±»å‹æ•°æ®çš„è¿‡æœŸæ—¶é—´å»ºè®®
SESSION_EXPIRE=7200      # ç”¨æˆ·ä¼šè¯ï¼š2å°æ—¶
CACHE_EXPIRE=1800        # ç¼“å­˜æ•°æ®ï¼š30åˆ†é’Ÿ  
VERIFY_CODE_EXPIRE=300   # éªŒè¯ç ï¼š5åˆ†é’Ÿ
TEMP_DATA_EXPIRE=86400   # ä¸´æ—¶æ•°æ®ï¼š24å°æ—¶

# è®¾ç½®è¿‡æœŸæ—¶é—´çš„æœ€ä½³å®è·µ
set_with_expire() {
    local key=$1
    local value=$2
    local expire=$3
    
    redis-cli SET "$key" "$value"
    redis-cli EXPIRE "$key" $expire
    
    echo "è®¾ç½®é”® $keyï¼Œè¿‡æœŸæ—¶é—´ $expire ç§’"
}

# ä½¿ç”¨ç¤ºä¾‹
set_with_expire "session:user123" "session_data" $SESSION_EXPIRE
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„å‘½ä»¤


```
ğŸ”¸ åŸºç¡€æ“ä½œï¼šEXISTSæ£€æŸ¥å­˜åœ¨ã€DELåˆ é™¤ã€TYPEæŸ¥çœ‹ç±»å‹ã€RENAMEé‡å‘½å
ğŸ”¸ æŸ¥æ‰¾éå†ï¼šSCANå®‰å…¨éå†ï¼ˆæ¨èï¼‰ã€KEYSæ¨¡å¼åŒ¹é…ï¼ˆå±é™©ï¼‰
ğŸ”¸ ç”Ÿå‘½å‘¨æœŸï¼šEXPIREè®¾ç½®è¿‡æœŸã€TTLæŸ¥çœ‹å‰©ä½™æ—¶é—´
ğŸ”¸ æ¸…ç©ºæ“ä½œï¼šFLUSHDBæ¸…ç©ºæ•°æ®åº“ã€FLUSHALLæ¸…ç©ºæ‰€æœ‰ï¼ˆå±é™©ï¼‰
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒå®‰å…¨å‡†åˆ™**
```
å®‰å…¨ä½¿ç”¨åŸåˆ™ï¼š
âœ… ä¼˜å…ˆä½¿ç”¨SCANä»£æ›¿KEYS
âœ… æ‰¹é‡æ“ä½œå‰å…ˆç¡®è®¤å½±å“èŒƒå›´
âœ… åˆ é™¤é‡è¦æ•°æ®å‰å¤‡ä»½
âœ… é…ç½®ç¦ç”¨å±é™©å‘½ä»¤
âœ… è®¾ç½®è®¿é—®å¯†ç å’ŒIPç™½åå•
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
æ€§èƒ½è€ƒè™‘ï¼š
â€¢ KEYSå‘½ä»¤ä¼šé˜»å¡æœåŠ¡å™¨ï¼Œç”Ÿäº§ç¯å¢ƒç¦ç”¨
â€¢ SCANåˆ†æ‰¹å¤„ç†ï¼Œå¯¹æœåŠ¡å™¨å½±å“å°
â€¢ æ‰¹é‡æ“ä½œæ¯”å¾ªç¯å•ä¸ªæ“ä½œæ•ˆç‡é«˜
â€¢ åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…å†…å­˜æ³„éœ²
```

**ğŸ”¹ å¸¸è§é”™è¯¯é¿å…**
```
é¿å…çŠ¯é”™ï¼š
âŒ åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨KEYS *
âŒ åˆ é™¤å‰ä¸æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
âŒ RENAMEæ—¶ä¸ç¡®è®¤ç›®æ ‡é”®æ˜¯å¦å·²å­˜åœ¨
âŒ å¿˜è®°ç»™ä¸´æ—¶æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´
âŒ æ‰¹é‡æ“ä½œæ—¶æ²¡æœ‰ç¡®è®¤å½±å“èŒƒå›´
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ—¥å¸¸ç»´æŠ¤åœºæ™¯**
```bash
# æ¸…ç†è¿‡æœŸä¼šè¯
redis-cli SCAN 0 MATCH session:* | while read key; do
    ttl=$(redis-cli TTL $key)
    if [ $ttl -eq -1 ]; then  # æ°¸ä¸è¿‡æœŸçš„ä¼šè¯
        redis-cli EXPIRE $key 7200  # è®¾ç½®2å°æ—¶è¿‡æœŸ
    fi
done

# æŸ¥çœ‹æ•°æ®åˆ†å¸ƒ
redis-cli SCAN 0 MATCH user:* COUNT 1000 | wc -l
redis-cli SCAN 0 MATCH cache:* COUNT 1000 | wc -l
redis-cli SCAN 0 MATCH session:* COUNT 1000 | wc -l
```

**ğŸ”§ æ•…éšœæ’æŸ¥å·¥å…·**
```bash
# æŸ¥æ‰¾å¤§é”®ï¼ˆå¯èƒ½å½±å“æ€§èƒ½çš„é”®ï¼‰
redis-cli --bigkeys

# æŸ¥çœ‹é”®çš„å†…å­˜å ç”¨
redis-cli MEMORY USAGE key_name

# åˆ†æé”®çš„ç±»å‹åˆ†å¸ƒ
redis-cli INFO keyspace
```

**ğŸ’¡ è®°å¿†è¦ç‚¹**
- EXISTSæ£€æŸ¥ã€DELåˆ é™¤ã€TYPEæŸ¥çœ‹ã€RENAMEæ”¹å
- ç”Ÿäº§ç¯å¢ƒç”¨SCANä¸ç”¨KEYSï¼Œå®‰å…¨ç¬¬ä¸€
- EXPIREè®¾ç½®è¿‡æœŸï¼ŒTTLæŸ¥çœ‹å‰©ä½™ï¼Œå†…å­˜ç®¡ç†è¦è®°ä½
- FLUSHDBå’ŒFLUSHALLè¦è°¨æ…ï¼Œè¯¯åˆ æ•°æ®æ‚”æ–­è‚ 
- æ‰¹é‡æ“ä½œæ•ˆç‡é«˜ï¼Œå®‰å…¨æ£€æŸ¥ä¸èƒ½å°‘