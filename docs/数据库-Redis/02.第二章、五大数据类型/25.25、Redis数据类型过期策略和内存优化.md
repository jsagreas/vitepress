---
title: 25ã€Redisæ•°æ®ç±»å‹è¿‡æœŸç­–ç•¥å’Œå†…å­˜ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [è¿‡æœŸç­–ç•¥è¯¦è§£](#1-è¿‡æœŸç­–ç•¥è¯¦è§£)
2. [å†…å­˜ä¼˜åŒ–ç­–ç•¥](#2-å†…å­˜ä¼˜åŒ–ç­–ç•¥)
3. [æ•°æ®æ¸…ç†æœºåˆ¶](#3-æ•°æ®æ¸…ç†æœºåˆ¶)
4. [å®¹é‡è§„åˆ’](#4-å®¹é‡è§„åˆ’)
5. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#5-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. â° è¿‡æœŸç­–ç•¥è¯¦è§£


### 1.1 æ•°æ®ç±»å‹çº§åˆ«è¿‡æœŸ


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
Redisçš„è¿‡æœŸæœºåˆ¶æ˜¯**ä»¥keyä¸ºå•ä½**çš„ï¼Œä¸ç®¡è¿™ä¸ªkeyå­˜å‚¨çš„æ˜¯Stringã€Hashã€Listè¿˜æ˜¯Setï¼Œéƒ½æ˜¯æ•´ä½“è¿‡æœŸï¼š

```
è¿‡æœŸæœºåˆ¶åŸç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  user:1001      â”‚ â† æ•´ä¸ªHashä¸€èµ·è¿‡æœŸ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ name: "å¼ ä¸‰"    â”‚
â”‚ age: 25         â”‚  
â”‚ score: 100      â”‚
â”‚ level: 5        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
è¿‡æœŸæ—¶é—´ï¼š2025-08-30 00:00:00
```

**ğŸ’¡ é€šä¿—ç†è§£**
å°±åƒè®¾ç½®é—¹é’Ÿä¸€æ ·ï¼Œæ—¶é—´åˆ°äº†æ•´ä¸ªæ•°æ®ç»“æ„å°±æ¶ˆå¤±äº†ï¼Œä¸èƒ½åªè®©æŸä¸ªå­—æ®µæ¶ˆå¤±ï¼š

```redis
# è®¾ç½®Hashè¿‡æœŸæ—¶é—´ï¼ˆ3600ç§’åè¿‡æœŸï¼‰
HSET user:1001 name "å¼ ä¸‰" age 25 score 100
EXPIRE user:1001 3600

# è®¾ç½®Setè¿‡æœŸæ—¶é—´
SADD tags:article:1001 "æŠ€æœ¯" "Redis" "æ•°æ®åº“"
EXPIRE tags:article:1001 7200

# è®¾ç½®Listè¿‡æœŸæ—¶é—´
LPUSH queue:tasks "task1" "task2" "task3" 
EXPIRE queue:tasks 1800

# æ£€æŸ¥å‰©ä½™è¿‡æœŸæ—¶é—´
TTL user:1001
# è¿”å›ï¼š3599ï¼ˆå‰©ä½™ç§’æ•°ï¼‰
```

**ğŸ“Š è¿‡æœŸæ—¶é—´è®¾ç½®æ–¹å¼å¯¹æ¯”**

| å‘½ä»¤ | **è¯´æ˜** | **ç¤ºä¾‹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|----------|-------------|
| `EXPIRE key seconds` | `è®¾ç½®ç§’çº§è¿‡æœŸæ—¶é—´` | `EXPIRE user:1001 3600` | `å¸¸è§„è¿‡æœŸè®¾ç½®` |
| `EXPIREAT key timestamp` | `è®¾ç½®å…·ä½“è¿‡æœŸæ—¶é—´ç‚¹` | `EXPIREAT user:1001 1693440000` | `å®šæ—¶è¿‡æœŸ` |
| `PEXPIRE key milliseconds` | `è®¾ç½®æ¯«ç§’çº§è¿‡æœŸæ—¶é—´` | `PEXPIRE session:abc 30000` | `ç²¾ç¡®è¿‡æœŸæ§åˆ¶` |
| `SETEX key seconds value` | `è®¾ç½®Stringå€¼åŒæ—¶è®¾ç½®è¿‡æœŸ` | `SETEX code:1001 300 "ABC123"` | `éªŒè¯ç åœºæ™¯` |

### 1.2 å­—æ®µçº§åˆ«è¿‡æœŸæ¨¡æ‹Ÿ


ç”±äºRedisä¸æ”¯æŒHashå­—æ®µçº§åˆ«çš„è¿‡æœŸï¼Œéœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼æ¨¡æ‹Ÿå®ç°ï¼š

**ğŸ”¸ æ–¹æ¡ˆ1ï¼šæ—¶é—´æˆ³å­—æ®µæ ‡è®°**
```redis
# åœ¨Hashä¸­å¢åŠ æ—¶é—´æˆ³å­—æ®µ
HSET user:session:1001 
     user_id "1001"
     login_time "1693440000"  
     last_activity "1693443600"
     expires_at "1693447200"     # è¿‡æœŸæ—¶é—´æˆ³

# è·å–æ•°æ®æ—¶æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
HMGET user:session:1001 user_id expires_at
# åœ¨åº”ç”¨å±‚åˆ¤æ–­ expires_at æ˜¯å¦å°äºå½“å‰æ—¶é—´
```

**ğŸ”¸ æ–¹æ¡ˆ2ï¼šç‹¬ç«‹keyå­˜å‚¨è¿‡æœŸå­—æ®µ**
```redis
# ä¸»è¦æ•°æ®å­˜åœ¨Hashä¸­
HSET user:1001 name "å¼ ä¸‰" age 25 score 100

# ä¸´æ—¶å­—æ®µå•ç‹¬å­˜å‚¨å¹¶è®¾ç½®è¿‡æœŸ
SETEX user:1001:temp_bonus 3600 "50"    # ä¸´æ—¶å¥–åŠ±1å°æ—¶åè¿‡æœŸ
SETEX user:1001:vip_status 86400 "gold" # VIPçŠ¶æ€24å°æ—¶åè¿‡æœŸ

# è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯
HGETALL user:1001
GET user:1001:temp_bonus
GET user:1001:vip_status
```

**ğŸ”¸ æ–¹æ¡ˆ3ï¼šLuaè„šæœ¬å®ç°è‡ªåŠ¨æ¸…ç†**
```lua
-- æ¸…ç†è¿‡æœŸHashå­—æ®µçš„Luaè„šæœ¬
local key = KEYS[1]
local current_time = tonumber(ARGV[1])
local hash_data = redis.call('HGETALL', key)

-- éå†Hashå­—æ®µï¼Œæ£€æŸ¥è¿‡æœŸæ—¶é—´
for i = 1, #hash_data, 2 do
    local field = hash_data[i]
    local value = hash_data[i + 1]
    
    -- å¦‚æœå­—æ®µåä»¥ expire_ å¼€å¤´ï¼Œæ£€æŸ¥æ˜¯å¦è¿‡æœŸ
    if string.find(field, "^expire_") then
        if tonumber(value) < current_time then
            -- åˆ é™¤è¿‡æœŸå­—æ®µå’Œå¯¹åº”çš„æ•°æ®å­—æ®µ
            local data_field = string.gsub(field, "^expire_", "")
            redis.call('HDEL', key, field, data_field)
        end
    end
end

return "OK"
```

### 1.3 è¿‡æœŸæ—¶é—´è®¾è®¡åŸåˆ™


**ğŸ¯ ä¸šåŠ¡åœºæ™¯ä¸è¿‡æœŸæ—¶é—´è®¾è®¡**

```
ç¼“å­˜æ•°æ®ï¼šæ ¹æ®æ•°æ®æ›´æ–°é¢‘ç‡è®¾ç½®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çƒ­ç‚¹æ•°æ®ï¼š15-30åˆ†é’Ÿ             â”‚
â”‚ ä¸€èˆ¬æ•°æ®ï¼š1-6å°æ—¶               â”‚
â”‚ å†·æ•°æ®ï¼š12-24å°æ—¶               â”‚
â”‚ é™æ€æ•°æ®ï¼š1-7å¤©                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼šè¯æ•°æ®ï¼šæ ¹æ®å®‰å…¨è¦æ±‚è®¾ç½®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç™»å½•ä¼šè¯ï¼š30åˆ†é’Ÿ-2å°æ—¶          â”‚
â”‚ è´­ç‰©è½¦ï¼š24å°æ—¶-7å¤©              â”‚
â”‚ éªŒè¯ç ï¼š1-10åˆ†é’Ÿ                â”‚
â”‚ ä¸´æ—¶ä»¤ç‰Œï¼š5-60åˆ†é’Ÿ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ è¿‡æœŸæ—¶é—´è®¾è®¡æŠ€å·§**

```redis
# 1. é”™å¼€è¿‡æœŸæ—¶é—´ï¼Œé¿å…ç¼“å­˜é›ªå´©
import random

def set_cache_with_random_expire(key, value, base_seconds):
    # åœ¨åŸºç¡€æ—¶é—´ä¸Šæ·»åŠ éšæœºåç§»é‡
    random_offset = random.randint(0, base_seconds * 0.1)  # 10%çš„éšæœºåç§»
    expire_time = base_seconds + random_offset
    
    redis.setex(key, expire_time, value)

# 2. æ ¹æ®è®¿é—®é¢‘ç‡åŠ¨æ€è°ƒæ•´è¿‡æœŸæ—¶é—´
def smart_expire(key, value, access_count):
    if access_count > 100:      # çƒ­ç‚¹æ•°æ®
        expire_time = 3600      # 1å°æ—¶
    elif access_count > 10:     # ä¸€èˆ¬æ•°æ®
        expire_time = 1800      # 30åˆ†é’Ÿ  
    else:                       # å†·æ•°æ®
        expire_time = 600       # 10åˆ†é’Ÿ
    
    redis.setex(key, expire_time, value)
```

### 1.4 è¿‡æœŸå›è°ƒå¤„ç†


**ğŸ”¸ è¿‡æœŸäº‹ä»¶é€šçŸ¥**
Redisæä¾›äº†keyè¿‡æœŸäº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œå¯ä»¥åœ¨æ•°æ®è¿‡æœŸæ—¶æ‰§è¡Œå›è°ƒå¤„ç†ï¼š

```redis
# å¼€å¯è¿‡æœŸäº‹ä»¶é€šçŸ¥
CONFIG SET notify-keyspace-events Ex

# è®¢é˜…è¿‡æœŸäº‹ä»¶
PSUBSCRIBE __keyevent@0__:expired
```

**ğŸ“ Pythonå®ç°è¿‡æœŸå›è°ƒ**
```python
import redis

def handle_expired_key(message):
    """å¤„ç†è¿‡æœŸçš„key"""
    expired_key = message['data'].decode()
    
    if expired_key.startswith('user:session:'):
        # ç”¨æˆ·ä¼šè¯è¿‡æœŸï¼Œè®°å½•æ—¥å¿—
        user_id = expired_key.split(':')[2]
        print(f"ç”¨æˆ· {user_id} çš„ä¼šè¯å·²è¿‡æœŸ")
        
    elif expired_key.startswith('product:cache:'):
        # å•†å“ç¼“å­˜è¿‡æœŸï¼Œè§¦å‘é‡æ–°åŠ è½½
        product_id = expired_key.split(':')[2]
        reload_product_cache(product_id)
        
    elif expired_key.startswith('rate_limit:'):
        # é™æµkeyè¿‡æœŸï¼Œé‡ç½®è®¡æ•°å™¨
        print(f"é™æµå™¨ {expired_key} å·²é‡ç½®")

# ç›‘å¬è¿‡æœŸäº‹ä»¶
r = redis.Redis()
pubsub = r.pubsub()
pubsub.psubscribe(**{'__keyevent@0__:expired': handle_expired_key})

for message in pubsub.listen():
    if message['type'] == 'pmessage':
        handle_expired_key(message)
```

---

## 2. ğŸ’¾ å†…å­˜ä¼˜åŒ–ç­–ç•¥


### 2.1 æ•°æ®ç±»å‹å†…å­˜å ç”¨å¯¹æ¯”


**ğŸ”¸ å„æ•°æ®ç±»å‹å†…å­˜æ•ˆç‡åˆ†æ**

```
å†…å­˜å ç”¨æµ‹è¯•ï¼ˆå­˜å‚¨ç›¸åŒæ•°æ®ï¼‰ï¼š

å­˜å‚¨1000ä¸ªç”¨æˆ·ä¿¡æ¯ï¼ˆid, name, age, scoreï¼‰

æ–¹æ¡ˆ1ï¼šStringåˆ†åˆ«å­˜å‚¨
user:1001:name â†’ "å¼ ä¸‰"     
user:1001:age â†’ "25"
user:1001:score â†’ "100"
æ€»å†…å­˜ï¼šçº¦420KB

æ–¹æ¡ˆ2ï¼šHashé›†ä¸­å­˜å‚¨  
user:1001 â†’ {name:"å¼ ä¸‰", age:"25", score:"100"}
æ€»å†…å­˜ï¼šçº¦280KB

æ–¹æ¡ˆ3ï¼šJSONå­—ç¬¦ä¸²å­˜å‚¨
user:1001 â†’ '{"name":"å¼ ä¸‰","age":"25","score":"100"}'
æ€»å†…å­˜ï¼šçº¦320KB

ç»“è®ºï¼šHashæ–¹å¼æœ€èŠ‚çœå†…å­˜ï¼ˆèŠ‚çœ33%ï¼‰
```

**ğŸ“Š å†…å­˜å ç”¨è¯¦ç»†å¯¹æ¯”**

| æ•°æ®ç±»å‹ | **1ä¸‡æ¡æ•°æ®** | **10ä¸‡æ¡æ•°æ®** | **å†…å­˜æ•ˆç‡** | **é€‚ç”¨åœºæ™¯** |
|---------|--------------|---------------|-------------|-------------|
| **String** | `15.2 MB` | `152 MB` | `åŸºå‡†å€¼` | `ç®€å•é”®å€¼å¯¹` |
| **Hash** | `10.1 MB` | `101 MB` | `èŠ‚çœ33%` | `å¤šå­—æ®µå¯¹è±¡` |
| **List** | `8.9 MB` | `89 MB` | `èŠ‚çœ41%` | `æœ‰åºé›†åˆ` |
| **Set** | `12.3 MB` | `123 MB` | `èŠ‚çœ19%` | `æ— åºä¸é‡å¤` |
| **ZSet** | `14.8 MB` | `148 MB` | `èŠ‚çœ3%` | `æœ‰åºä¸é‡å¤` |

### 2.2 å‹ç¼©é…ç½®ä¼˜åŒ–


**ğŸ”¸ Hashå‹ç¼©é…ç½®**
Rediså¯¹å°Hashæä¾›äº†å‹ç¼©å­˜å‚¨ä¼˜åŒ–ï¼š

```redis
# Hashå‹ç¼©é…ç½®å‚æ•°
hash-max-ziplist-entries 512    # Hashå­—æ®µæ•°é‡é˜ˆå€¼
hash-max-ziplist-value 64       # å•ä¸ªå­—æ®µå€¼å¤§å°é˜ˆå€¼

# å½“HashåŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ä½¿ç”¨å‹ç¼©å­˜å‚¨ï¼š
# 1. å­—æ®µæ•°é‡ â‰¤ 512ä¸ª
# 2. æ¯ä¸ªå­—æ®µå€¼å¤§å° â‰¤ 64å­—èŠ‚
```

**ğŸ’¡ å‹ç¼©æ•ˆæœå¯¹æ¯”**
```
æµ‹è¯•æ•°æ®ï¼š100ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µ20å­—èŠ‚

æ™®é€šHashå­˜å‚¨ï¼š
å†…å­˜å ç”¨ï¼š15.2KB
å­˜å–é€Ÿåº¦ï¼šO(1)

å‹ç¼©Hashå­˜å‚¨ï¼š
å†…å­˜å ç”¨ï¼š8.9KB        # èŠ‚çœ41%å†…å­˜
å­˜å–é€Ÿåº¦ï¼šO(n)         # éœ€è¦éå†æŸ¥æ‰¾

å»ºè®®ï¼š
- å­—æ®µæ•°é‡å°‘(<100)ï¼šå¼€å¯å‹ç¼©
- å­—æ®µæ•°é‡å¤š(>500)ï¼šå…³é—­å‹ç¼©  
- è¿½æ±‚é€Ÿåº¦ï¼šå…³é—­å‹ç¼©
- èŠ‚çœå†…å­˜ï¼šå¼€å¯å‹ç¼©
```

**ğŸ”¸ Listå‹ç¼©é…ç½®**
```redis
# Listå‹ç¼©é…ç½®
list-max-ziplist-size -2        # å•ä¸ªèŠ‚ç‚¹æœ€å¤§å†…å­˜(8KB)
list-compress-depth 1           # å‹ç¼©æ·±åº¦(å¤´å°¾å„1ä¸ªèŠ‚ç‚¹ä¸å‹ç¼©)

# ç¤ºä¾‹ï¼š
# [èŠ‚ç‚¹1] - [å‹ç¼©èŠ‚ç‚¹] - [å‹ç¼©èŠ‚ç‚¹] - [èŠ‚ç‚¹N]
#   â†‘                                    â†‘
# ä¸å‹ç¼©                               ä¸å‹ç¼©
```

### 2.3 å¤§å¯¹è±¡æ‹†åˆ†ç­–ç•¥


**ğŸ”¸ é—®é¢˜åœºæ™¯**
å½“å•ä¸ªkeyå­˜å‚¨çš„æ•°æ®è¿‡å¤§æ—¶ï¼Œä¼šå½±å“Redisæ€§èƒ½ï¼š

```
å¤§Hashé—®é¢˜ï¼š
user:1001 åŒ…å«10000ä¸ªå­—æ®µ
- å•æ¬¡HGETALLè€—æ—¶è¿‡é•¿
- è¿‡æœŸæ—¶ä¸€æ¬¡æ€§é‡Šæ”¾å¤§é‡å†…å­˜
- é˜»å¡å…¶ä»–æ“ä½œ

å¤§Listé—®é¢˜ï¼š  
message:queue åŒ…å«100ä¸‡æ¡æ¶ˆæ¯
- LRANGEæ“ä½œå¯èƒ½è¶…æ—¶
- å†…å­˜å ç”¨é›†ä¸­åœ¨å•ä¸ªkey
- åˆ é™¤æ—¶é€ æˆé˜»å¡
```

**ğŸ”¸ æ‹†åˆ†ç­–ç•¥**

**Hashæ‹†åˆ†ç¤ºä¾‹**
```redis
# åŸå§‹å¤§Hashï¼ˆä¸æ¨èï¼‰
HSET user:1001:all field1 value1 field2 value2 ... field10000 value10000

# æ‹†åˆ†ä¸ºå¤šä¸ªå°Hashï¼ˆæ¨èï¼‰
HSET user:1001:basic name "å¼ ä¸‰" age 25 email "zhang@example.com"
HSET user:1001:stats score 1500 level 15 coins 300  
HSET user:1001:profile avatar "avatar.jpg" intro "ä¸ªäººç®€ä»‹"
HSET user:1001:settings theme "dark" language "zh-CN"

# æ‰¹é‡è·å–ç”¨æˆ·ä¿¡æ¯
MULTI
HGETALL user:1001:basic
HGETALL user:1001:stats  
HGETALL user:1001:profile
EXEC
```

**Liståˆ†ç‰‡ç¤ºä¾‹**
```redis
# æ¶ˆæ¯é˜Ÿåˆ—åˆ†ç‰‡
def push_message(message):
    # æ ¹æ®æ—¶é—´æˆ³è®¡ç®—åˆ†ç‰‡
    shard_key = f"queue:{int(time.time()) // 3600}"  # æŒ‰å°æ—¶åˆ†ç‰‡
    redis.lpush(shard_key, message)
    redis.expire(shard_key, 86400)  # 24å°æ—¶è¿‡æœŸ

def pop_message():
    # ä»æœ€æ–°åˆ†ç‰‡è·å–æ¶ˆæ¯
    current_shard = f"queue:{int(time.time()) // 3600}"
    message = redis.rpop(current_shard)
    
    if not message:
        # å°è¯•ä»å‰ä¸€ä¸ªåˆ†ç‰‡è·å–
        prev_shard = f"queue:{int(time.time()) // 3600 - 1}"
        message = redis.rpop(prev_shard)
    
    return message
```

### 2.4 å†…å­˜ç¢ç‰‡æ•´ç†


**ğŸ”¸ å†…å­˜ç¢ç‰‡äº§ç”ŸåŸå› **
```
ç¢ç‰‡äº§ç”Ÿè¿‡ç¨‹ï¼š
1. å¤§é‡å†™å…¥æ•°æ® â†’ å†…å­˜åˆ†é…
2. åˆ é™¤éƒ¨åˆ†æ•°æ® â†’ äº§ç”Ÿå†…å­˜ç©ºæ´  
3. å†™å…¥æ–°æ•°æ® â†’ æ–°å†…å­˜åˆ†é…
4. å¾ªç¯å¾€å¤ â†’ å†…å­˜ç¢ç‰‡å¢å¤š

ç¤ºä¾‹ï¼š
å·²ç”¨å†…å­˜ï¼š800MB
å®é™…å­˜å‚¨ï¼š600MB  
ç¢ç‰‡ç‡ï¼š(800-600)/600 = 33%
```

**ğŸ“Š å†…å­˜ç¢ç‰‡ç›‘æ§**
```redis
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
INFO memory

# å…³é”®æŒ‡æ ‡ï¼š
used_memory_human:600.00M           # é€»è¾‘å†…å­˜ä½¿ç”¨
used_memory_rss_human:800.00M       # ç‰©ç†å†…å­˜ä½¿ç”¨  
mem_fragmentation_ratio:1.33        # ç¢ç‰‡ç‡
```

**ğŸ”¸ ç¢ç‰‡æ•´ç†æ–¹æ³•**

```redis
# æ–¹æ³•1ï¼šä¸»åŠ¨ç¢ç‰‡æ•´ç†ï¼ˆRedis 4.0+ï¼‰
CONFIG SET activedefrag yes                    # å¼€å¯ä¸»åŠ¨æ•´ç†
CONFIG SET active-defrag-ignore-bytes 100mb   # å†…å­˜ä½¿ç”¨è¶…è¿‡100MBæ‰æ•´ç†
CONFIG SET active-defrag-threshold-lower 10   # ç¢ç‰‡ç‡è¶…è¿‡10%æ‰æ•´ç†

# æ–¹æ³•2ï¼šé‡å¯æ•´ç†ï¼ˆç®€å•ç²—æš´ï¼‰
# å°†æ•°æ®å¯¼å‡ºåé‡å¯Redisï¼Œé‡æ–°åŠ è½½æ•°æ®

# æ–¹æ³•3ï¼šä¸»ä»åˆ‡æ¢æ•´ç†
# åˆ©ç”¨ä¸»ä»å¤åˆ¶ï¼Œåˆ‡æ¢ä¸»åº“å®ç°ç¢ç‰‡æ•´ç†
```

---

## 3. ğŸ§¹ æ•°æ®æ¸…ç†æœºåˆ¶


### 3.1 è‡ªåŠ¨æ¸…ç†ç­–ç•¥


**ğŸ”¸ Redisè¿‡æœŸç­–ç•¥æœºåˆ¶**
Redisä½¿ç”¨**æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤**çš„ç»„åˆç­–ç•¥ï¼š

```
è¿‡æœŸå¤„ç†æµç¨‹ï¼š

å®¢æˆ·ç«¯è®¿é—®key
     â†“
æ£€æŸ¥æ˜¯å¦è¿‡æœŸ? â†’ æ˜¯ â†’ ç«‹å³åˆ é™¤ â†’ è¿”å›nil
     â†“ å¦
è¿”å›æ­£å¸¸æ•°æ®

å®šæ—¶ä»»åŠ¡(æ¯ç§’æ‰§è¡Œ)
     â†“  
éšæœºæ£€æŸ¥éƒ¨åˆ†key
     â†“
å‘ç°è¿‡æœŸkey â†’ åˆ é™¤
     â†“
ç»§ç»­æ£€æŸ¥...
```

**ğŸ’¡ è¿‡æœŸåˆ é™¤é…ç½®**
```redis
# æ¯æ¬¡å®šæœŸåˆ é™¤æ£€æŸ¥çš„keyæ•°é‡
# é»˜è®¤æ¯æ¬¡æ£€æŸ¥20ä¸ªkey
CONFIG GET hz
CONFIG SET hz 10    # é™ä½CPUä½¿ç”¨ï¼Œä½†è¿‡æœŸåˆ é™¤å˜æ…¢

# æœ€å¤§åˆ é™¤æ—¶é—´é™åˆ¶
# é»˜è®¤æ¯æ¬¡åˆ é™¤æ“ä½œæœ€å¤šå ç”¨25ms
maxmemory-samples 5  # å–æ ·æ•°é‡
```

### 3.2 æ‰‹åŠ¨æ¸…ç†è„šæœ¬


**ğŸ”¸ æ‰¹é‡æ¸…ç†è¿‡æœŸæ•°æ®**
```python
import redis
import time
from datetime import datetime

class RedisDataCleaner:
    def __init__(self, redis_client):
        self.redis = redis_client
    
    def clean_expired_keys(self, pattern="*", batch_size=1000):
        """æ¸…ç†åŒ¹é…æ¨¡å¼çš„è¿‡æœŸkey"""
        cleaned_count = 0
        
        for keys_batch in self._scan_keys(pattern, batch_size):
            pipe = self.redis.pipeline()
            
            # æ£€æŸ¥æ¯ä¸ªkeyçš„TTL
            for key in keys_batch:
                pipe.ttl(key)
            
            ttl_results = pipe.execute()
            
            # åˆ é™¤å·²è¿‡æœŸçš„keyï¼ˆTTL = -2è¡¨ç¤ºkeyä¸å­˜åœ¨æˆ–å·²è¿‡æœŸï¼‰
            expired_keys = [
                key for key, ttl in zip(keys_batch, ttl_results) 
                if ttl == -2
            ]
            
            if expired_keys:
                self.redis.delete(*expired_keys)
                cleaned_count += len(expired_keys)
                print(f"æ¸…ç†äº† {len(expired_keys)} ä¸ªè¿‡æœŸkey")
        
        return cleaned_count
    
    def _scan_keys(self, pattern, batch_size):
        """åˆ†æ‰¹æ‰«ækeyï¼Œé¿å…é˜»å¡"""
        cursor = 0
        while True:
            cursor, keys = self.redis.scan(cursor, match=pattern, count=batch_size)
            if keys:
                yield keys
            if cursor == 0:
                break

# ä½¿ç”¨ç¤ºä¾‹
r = redis.Redis()
cleaner = RedisDataCleaner(r)

# æ¸…ç†ç¼“å­˜ç›¸å…³çš„è¿‡æœŸkey
cleaned = cleaner.clean_expired_keys("cache:*")
print(f"æ€»å…±æ¸…ç†äº† {cleaned} ä¸ªkey")
```

**ğŸ”¸ æŒ‰ä¸šåŠ¡åœºæ™¯æ¸…ç†**
```python
def clean_user_sessions():
    """æ¸…ç†ç”¨æˆ·ä¼šè¯æ•°æ®"""
    current_time = int(time.time())
    
    # æ¸…ç†30å¤©æœªæ´»è·ƒçš„ä¼šè¯
    inactive_threshold = current_time - 30 * 24 * 3600
    
    for key in redis.scan_iter(match="user:session:*"):
        last_activity = redis.hget(key, "last_activity")
        if last_activity and int(last_activity) < inactive_threshold:
            redis.delete(key)
            print(f"åˆ é™¤éæ´»è·ƒä¼šè¯: {key}")

def clean_temp_data():
    """æ¸…ç†ä¸´æ—¶æ•°æ®"""
    # æ¸…ç†éªŒè¯ç ï¼ˆè¶…è¿‡10åˆ†é’Ÿï¼‰
    for key in redis.scan_iter(match="code:*"):
        if redis.ttl(key) == -1:  # æ²¡æœ‰è¿‡æœŸæ—¶é—´çš„éªŒè¯ç 
            redis.expire(key, 600)  # è®¾ç½®10åˆ†é’Ÿè¿‡æœŸ
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¼•ç”¨ï¼ˆè¶…è¿‡1å¤©ï¼‰  
    for key in redis.scan_iter(match="temp:file:*"):
        create_time = redis.hget(key, "create_time")
        if create_time:
            if time.time() - float(create_time) > 86400:
                redis.delete(key)
```

### 3.3 å®šæ—¶æ¸…ç†ä»»åŠ¡


**ğŸ”¸ ä½¿ç”¨Linux Cronå®šæ—¶æ¸…ç†**
```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œæ¸…ç†è„šæœ¬
0 2 * * * /usr/bin/python3 /path/to/redis_cleaner.py >> /var/log/redis_clean.log 2>&1

# æ¯å°æ—¶æ¸…ç†ä¸´æ—¶æ•°æ®
0 * * * * /usr/bin/python3 /path/to/clean_temp.py
```

**ğŸ”¸ Pythonå®šæ—¶ä»»åŠ¡**
```python
import schedule
import time

def scheduled_cleanup():
    """å®šæ—¶æ¸…ç†ä»»åŠ¡"""
    try:
        # æ¸…ç†è¿‡æœŸç¼“å­˜
        cache_cleaned = cleaner.clean_expired_keys("cache:*")
        
        # æ¸…ç†ç”¨æˆ·ä¼šè¯
        session_cleaned = cleaner.clean_expired_keys("user:session:*")
        
        # æ¸…ç†ä¸´æ—¶æ•°æ®
        temp_cleaned = cleaner.clean_expired_keys("temp:*")
        
        print(f"æ¸…ç†å®Œæˆ: ç¼“å­˜{cache_cleaned}, ä¼šè¯{session_cleaned}, ä¸´æ—¶{temp_cleaned}")
        
    except Exception as e:
        print(f"æ¸…ç†å¤±è´¥: {e}")

# è®¾ç½®å®šæ—¶ä»»åŠ¡
schedule.every().day.at("02:00").do(scheduled_cleanup)    # æ¯å¤©2ç‚¹
schedule.every().hour.do(partial_cleanup)                # æ¯å°æ—¶æ¸…ç†éƒ¨åˆ†æ•°æ®

# è¿è¡Œå®šæ—¶ä»»åŠ¡
while True:
    schedule.run_pending()
    time.sleep(60)
```

### 3.4 æ¸…ç†æ•ˆæœç›‘æ§


**ğŸ”¸ ç›‘æ§æŒ‡æ ‡**
```python
def monitor_cleanup_effect():
    """ç›‘æ§æ¸…ç†æ•ˆæœ"""
    info = redis.info()
    
    metrics = {
        "used_memory_mb": round(info['used_memory'] / 1024 / 1024, 2),
        "used_memory_peak_mb": round(info['used_memory_peak'] / 1024 / 1024, 2),
        "fragmentation_ratio": info['mem_fragmentation_ratio'],
        "expired_keys": info['expired_keys'],
        "evicted_keys": info['evicted_keys'],
        "keyspace_hits": info['keyspace_hits'],
        "keyspace_misses": info['keyspace_misses'],
    }
    
    # è®¡ç®—å‘½ä¸­ç‡
    total_requests = metrics['keyspace_hits'] + metrics['keyspace_misses']
    if total_requests > 0:
        metrics['hit_rate'] = round(metrics['keyspace_hits'] / total_requests * 100, 2)
    
    return metrics

# æ¸…ç†å‰åå¯¹æ¯”
before = monitor_cleanup_effect()
cleaned_count = cleaner.clean_expired_keys("*")
after = monitor_cleanup_effect()

print("æ¸…ç†æ•ˆæœå¯¹æ¯”:")
print(f"é‡Šæ”¾å†…å­˜: {before['used_memory_mb'] - after['used_memory_mb']:.2f}MB")
print(f"æ¸…ç†keyæ•°é‡: {cleaned_count}")
print(f"ç¢ç‰‡ç‡å˜åŒ–: {before['fragmentation_ratio']:.2f} â†’ {after['fragmentation_ratio']:.2f}")
```

---

## 4. ğŸ“Š å®¹é‡è§„åˆ’


### 4.1 æ•°æ®å¢é•¿é¢„ä¼°


**ğŸ”¸ ä¸šåŠ¡æ•°æ®å¢é•¿åˆ†æ**
```
ç”¨æˆ·æ•°æ®å¢é•¿æ¨¡å‹ï¼š

åŸºç¡€æ•°æ®ï¼š
- æ–°ç”¨æˆ·æ³¨å†Œï¼š1000äºº/å¤©
- ç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼šæ¯ç”¨æˆ· 2KB
- ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼šæ¯ç”¨æˆ·æ¯å¤© 5KB
- ç¼“å­˜æ•°æ®ï¼šç”¨æˆ·æ•°æ®çš„ 1.5å€

æœˆå¢é•¿é‡è®¡ç®—ï¼š
ç”¨æˆ·åŸºç¡€æ•°æ®ï¼š1000 Ã— 30 Ã— 2KB = 60MB/æœˆ
ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼š1000 Ã— 30 Ã— 5KB = 150MB/æœˆ  
ç¼“å­˜æ•°æ®ï¼š(60 + 150) Ã— 1.5 = 315MB/æœˆ
æ€»è®¡ï¼š525MB/æœˆ

å¹´å¢é•¿é‡ï¼š525MB Ã— 12 = 6.3GB/å¹´
```

**ğŸ“Š ä¸åŒä¸šåŠ¡åœºæ™¯çš„å®¹é‡é¢„ä¼°**

| ä¸šåŠ¡åœºæ™¯ | **æ•°æ®ç±»å‹** | **å•æ¡å¤§å°** | **æ—¥å¢é‡** | **æœˆå¢é•¿** | **ä¿ç•™æœŸ** |
|---------|-------------|-------------|-----------|-----------|-----------|
| **ç”¨æˆ·ç¼“å­˜** | `Hash` | `2KB` | `1000æ¡` | `60MB` | `7å¤©` |
| **ä¼šè¯å­˜å‚¨** | `String` | `1KB` | `5000æ¡` | `150MB` | `30å¤©` |
| **æ¶ˆæ¯é˜Ÿåˆ—** | `List` | `500B` | `10ä¸‡æ¡` | `1.5GB` | `3å¤©` |
| **è®¡æ•°ç»Ÿè®¡** | `Hash` | `100B` | `1ä¸‡æ¡` | `30MB` | `æ°¸ä¹…` |
| **æœç´¢ç´¢å¼•** | `Set` | `50B` | `5ä¸‡æ¡` | `75MB` | `30å¤©` |

### 4.2 å†…å­˜å®¹é‡è§„åˆ’


**ğŸ”¸ å®¹é‡è§„åˆ’è®¡ç®—å…¬å¼**
```
Rediså†…å­˜éœ€æ±‚ = æ•°æ®å†…å­˜ + ç³»ç»Ÿå¼€é”€ + å®‰å…¨ç¼“å†²

æ•°æ®å†…å­˜ï¼šå®é™…å­˜å‚¨çš„ä¸šåŠ¡æ•°æ®
ç³»ç»Ÿå¼€é”€ï¼šRediså…ƒæ•°æ®ã€ç´¢å¼•ã€è¿‡æœŸå­—å…¸ç­‰ï¼ˆçº¦20-30%ï¼‰
å®‰å…¨ç¼“å†²ï¼šåº”å¯¹çªå‘æµé‡ï¼ˆå»ºè®®é¢„ç•™30-50%ï¼‰

ç¤ºä¾‹è®¡ç®—ï¼š
ä¸šåŠ¡æ•°æ®ï¼š10GB
ç³»ç»Ÿå¼€é”€ï¼š10GB Ã— 0.25 = 2.5GB
å®‰å…¨ç¼“å†²ï¼š(10GB + 2.5GB) Ã— 0.4 = 5GB
æ€»éœ€æ±‚ï¼š17.5GB
```

**ğŸ’¡ å®¹é‡è§„åˆ’å®è·µ**
```python
def calculate_redis_capacity(business_data_gb, 
                           system_overhead_ratio=0.25,
                           safety_buffer_ratio=0.4):
    """è®¡ç®—Rediså®¹é‡éœ€æ±‚"""
    
    # ç³»ç»Ÿå¼€é”€
    system_overhead = business_data_gb * system_overhead_ratio
    
    # åŸºç¡€éœ€æ±‚
    base_requirement = business_data_gb + system_overhead
    
    # å®‰å…¨ç¼“å†²
    safety_buffer = base_requirement * safety_buffer_ratio
    
    # æ€»å®¹é‡éœ€æ±‚
    total_capacity = base_requirement + safety_buffer
    
    return {
        "business_data": business_data_gb,
        "system_overhead": system_overhead,
        "base_requirement": base_requirement,
        "safety_buffer": safety_buffer,
        "total_capacity": total_capacity,
        "recommended_memory": int(total_capacity * 1.1)  # å†åŠ 10%ä½™é‡
    }

# ä½¿ç”¨ç¤ºä¾‹
capacity = calculate_redis_capacity(10)  # 10GBä¸šåŠ¡æ•°æ®
print(f"æ¨èå†…å­˜é…ç½®: {capacity['recommended_memory']}GB")
```

### 4.3 æ‰©å®¹è§¦å‘æ¡ä»¶


**ğŸ”¸ ç›‘æ§æŒ‡æ ‡ä¸é˜ˆå€¼**
```python
def check_scale_up_conditions(redis_info):
    """æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹"""
    conditions = []
    
    # å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%
    memory_usage = redis_info['used_memory'] / redis_info['maxmemory']
    if memory_usage > 0.8:
        conditions.append(f"å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: {memory_usage:.1%}")
    
    # ç¢ç‰‡ç‡è¶…è¿‡1.5
    if redis_info['mem_fragmentation_ratio'] > 1.5:
        conditions.append(f"å†…å­˜ç¢ç‰‡è¿‡å¤š: {redis_info['mem_fragmentation_ratio']:.2f}")
    
    # å‘½ä¸­ç‡ä½äº90%
    hits = redis_info['keyspace_hits']
    misses = redis_info['keyspace_misses'] 
    if hits + misses > 0:
        hit_rate = hits / (hits + misses)
        if hit_rate < 0.9:
            conditions.append(f"ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½: {hit_rate:.1%}")
    
    # è¿æ¥æ•°æ¥è¿‘ä¸Šé™
    if redis_info['connected_clients'] > redis_info['maxclients'] * 0.8:
        conditions.append("è¿æ¥æ•°æ¥è¿‘ä¸Šé™")
    
    return conditions

# ç›‘æ§ç¤ºä¾‹
info = redis.info()
scale_conditions = check_scale_up_conditions(info)

if scale_conditions:
    print("éœ€è¦è€ƒè™‘æ‰©å®¹:")
    for condition in scale_conditions:
        print(f"- {condition}")
```

**ğŸ“Š æ‰©å®¹å†³ç­–çŸ©é˜µ**

| æŒ‡æ ‡ | **æ­£å¸¸** | **æ³¨æ„** | **è­¦å‘Š** | **ç´§æ€¥** |
|------|---------|---------|---------|---------|
| **å†…å­˜ä½¿ç”¨ç‡** | `< 60%` | `60-75%` | `75-85%` | `> 85%` |
| **ç¢ç‰‡ç‡** | `< 1.3` | `1.3-1.5` | `1.5-2.0` | `> 2.0` |
| **å‘½ä¸­ç‡** | `> 95%` | `90-95%` | `80-90%` | `< 80%` |
| **å“åº”æ—¶é—´** | `< 1ms` | `1-5ms` | `5-10ms` | `> 10ms` |

### 4.4 æˆæœ¬æ•ˆç›Šåˆ†æ


**ğŸ”¸ æ‰©å®¹æ–¹æ¡ˆå¯¹æ¯”**
```
æ–¹æ¡ˆ1ï¼šå‚ç›´æ‰©å®¹ï¼ˆå¢åŠ å•æœºå†…å­˜ï¼‰
ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ï¼Œæ— éœ€ä¿®æ”¹åº”ç”¨
ç¼ºç‚¹ï¼šæˆæœ¬é«˜ï¼Œå­˜åœ¨å•ç‚¹æ•…éšœ
æˆæœ¬ï¼š16GB â†’ 32GBï¼Œå¢åŠ æˆæœ¬çº¦2000å…ƒ/æœˆ

æ–¹æ¡ˆ2ï¼šæ°´å¹³æ‰©å®¹ï¼ˆRedisé›†ç¾¤ï¼‰  
ä¼˜ç‚¹ï¼šæˆæœ¬ä½ï¼Œé«˜å¯ç”¨ï¼Œå¯çº¿æ€§æ‰©å±•
ç¼ºç‚¹ï¼šé…ç½®å¤æ‚ï¼Œéœ€è¦ä¿®æ”¹åº”ç”¨
æˆæœ¬ï¼š2å°16GBæœºå™¨ï¼Œå¢åŠ æˆæœ¬çº¦1500å…ƒ/æœˆ

æ–¹æ¡ˆ3ï¼šæ•°æ®åˆ†å±‚å­˜å‚¨
ä¼˜ç‚¹ï¼šæˆæœ¬æœ€ä½ï¼Œå……åˆ†åˆ©ç”¨èµ„æº
ç¼ºç‚¹ï¼šåº”ç”¨é€»è¾‘å¤æ‚ï¼Œç®¡ç†æˆæœ¬é«˜
æˆæœ¬ï¼šçƒ­æ•°æ®Redis + å†·æ•°æ®MySQLï¼Œå¢åŠ æˆæœ¬çº¦800å…ƒ/æœˆ
```

**ğŸ’° æˆæœ¬è®¡ç®—æ¨¡å‹**
```python
def cost_benefit_analysis(current_memory_gb, target_memory_gb, monthly_cost_per_gb=100):
    """æˆæœ¬æ•ˆç›Šåˆ†æ"""
    
    # å‚ç›´æ‰©å®¹æˆæœ¬
    vertical_cost = (target_memory_gb - current_memory_gb) * monthly_cost_per_gb
    
    # æ°´å¹³æ‰©å®¹æˆæœ¬ï¼ˆå‡è®¾éœ€è¦2å°æœºå™¨ï¼‰
    horizontal_cost = current_memory_gb * monthly_cost_per_gb * 1.2  # 20%é¢å¤–å¼€é”€
    
    # æ•°æ®åˆ†å±‚æˆæœ¬ï¼ˆå‡è®¾70%çƒ­æ•°æ®ç”¨Redisï¼‰
    hot_data_ratio = 0.7
    redis_memory = target_memory_gb * hot_data_ratio
    tiered_cost = redis_memory * monthly_cost_per_gb + 200  # MySQLæˆæœ¬
    
    return {
        "vertical_scaling": vertical_cost,
        "horizontal_scaling": horizontal_cost, 
        "tiered_storage": tiered_cost,
        "current_cost": current_memory_gb * monthly_cost_per_gb
    }

# æˆæœ¬åˆ†æç¤ºä¾‹
costs = cost_benefit_analysis(16, 32)
print("æ‰©å®¹æˆæœ¬å¯¹æ¯” (æœˆ):")
for method, cost in costs.items():
    print(f"{method}: {cost}å…ƒ")
```

---

## 5. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 5.1 å¿…é¡»æŒæ¡çš„è¿‡æœŸç­–ç•¥


```
ğŸ”¸ è¿‡æœŸæœºåˆ¶ç‰¹ç‚¹
â€¢ Redisè¿‡æœŸæ˜¯ä»¥keyä¸ºå•ä½ï¼Œæ•´ä¸ªæ•°æ®ç»“æ„ä¸€èµ·è¿‡æœŸ
â€¢ ä½¿ç”¨æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤çš„ç»„åˆç­–ç•¥
â€¢ ä¸æ”¯æŒHashå­—æ®µçº§åˆ«è¿‡æœŸï¼Œéœ€è¦åº”ç”¨å±‚æ¨¡æ‹Ÿ

ğŸ”¸ è¿‡æœŸæ—¶é—´è®¾ç½®åŸåˆ™
â€¢ æ ¹æ®ä¸šåŠ¡åœºæ™¯åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´
â€¢ æ·»åŠ éšæœºåç§»é¿å…ç¼“å­˜é›ªå´©
â€¢ ä½¿ç”¨è¿‡æœŸäº‹ä»¶é€šçŸ¥å¤„ç†ä¸šåŠ¡é€»è¾‘
```

### 5.2 å…³é”®å†…å­˜ä¼˜åŒ–ç­–ç•¥


**ğŸ”¹ æ•°æ®ç±»å‹é€‰æ‹©åŸåˆ™**
```
Hash vs String:
âœ… å¤šå­—æ®µç›¸å…³æ•°æ®é€‰æ‹©Hashï¼ŒèŠ‚çœ30%+å†…å­˜
âœ… å•å­—æ®µæˆ–éœ€è¦ç‹¬ç«‹è¿‡æœŸé€‰æ‹©String

å‹ç¼©é…ç½®ä¼˜åŒ–:
âœ… å°å¯¹è±¡å¼€å¯å‹ç¼©ï¼Œå¤§å¹…èŠ‚çœå†…å­˜
âœ… å¤§å¯¹è±¡å…³é—­å‹ç¼©ï¼Œä¿è¯è®¿é—®æ€§èƒ½
```

**ğŸ”¹ å¤§å¯¹è±¡å¤„ç†ç­–ç•¥**
```
æ‹†åˆ†åŸåˆ™:
- Hashè¶…è¿‡1000å­—æ®µè€ƒè™‘æ‹†åˆ†
- Listè¶…è¿‡10ä¸‡å…ƒç´ è€ƒè™‘åˆ†ç‰‡
- å•ä¸ªvalueè¶…è¿‡1MBè€ƒè™‘å‹ç¼©

å†…å­˜ç¢ç‰‡ç®¡ç†:
- ç›‘æ§ç¢ç‰‡ç‡ï¼Œè¶…è¿‡1.5æ—¶å¤„ç†
- ä½¿ç”¨ä¸»åŠ¨æ•´ç†æˆ–é‡å¯æ•´ç†
```

### 5.3 æ•°æ®æ¸…ç†æœ€ä½³å®è·µ


**ğŸ’¡ è‡ªåŠ¨åŒ–æ¸…ç†ç­–ç•¥**
- åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè®©Redisè‡ªåŠ¨æ¸…ç†
- å®šæœŸè¿è¡Œæ¸…ç†è„šæœ¬ï¼Œåˆ é™¤æ— æ•ˆæ•°æ®
- ç›‘æ§æ¸…ç†æ•ˆæœï¼Œè°ƒæ•´æ¸…ç†é¢‘ç‡

**âš ï¸ æ¸…ç†æ³¨æ„äº‹é¡¹**
- æ‰¹é‡åˆ é™¤æ—¶æ§åˆ¶æ¯æ‰¹æ•°é‡ï¼Œé¿å…é˜»å¡
- åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œå¤§æ‰¹é‡æ¸…ç†
- æ¸…ç†å‰å¤‡ä»½é‡è¦æ•°æ®

### 5.4 å®¹é‡è§„åˆ’æŒ‡å¯¼åŸåˆ™


**ğŸ¯ è§„åˆ’æ­¥éª¤**
1. **æ•°æ®å¢é•¿é¢„ä¼°**ï¼šæ ¹æ®ä¸šåŠ¡å¢é•¿é¢„æµ‹æ•°æ®é‡
2. **å®¹é‡éœ€æ±‚è®¡ç®—**ï¼šæ•°æ®é‡Ã—1.5~2å€ä½œä¸ºRediså®¹é‡
3. **ç›‘æ§é˜ˆå€¼è®¾ç½®**ï¼šå†…å­˜ä½¿ç”¨80%ã€ç¢ç‰‡ç‡1.5ä¸ºè­¦æˆ’çº¿
4. **æ‰©å®¹æ–¹æ¡ˆé€‰æ‹©**ï¼šæ ¹æ®æˆæœ¬å’ŒæŠ€æœ¯è¦æ±‚é€‰æ‹©æ‰©å®¹æ–¹å¼

**ğŸ“Š ç›‘æ§å…³é”®æŒ‡æ ‡**
- å†…å­˜ä½¿ç”¨ç‡ï¼šused_memory / maxmemory
- ç¢ç‰‡ç‡ï¼šmem_fragmentation_ratio  
- å‘½ä¸­ç‡ï¼škeyspace_hits / (hits + misses)
- è¿‡æœŸæ¸…ç†ï¼šexpired_keyså¢é•¿é€Ÿåº¦

**æ ¸å¿ƒè®°å¿†**ï¼š
- è¿‡æœŸä»¥keyä¸ºå•ä½ï¼Œåˆç†è®¾è®¡è¿‡æœŸæ—¶é—´
- é€‰æ‹©åˆé€‚æ•°æ®ç±»å‹ï¼Œå¼€å¯å‹ç¼©ä¼˜åŒ–å†…å­˜
- å¤§å¯¹è±¡åŠæ—¶æ‹†åˆ†ï¼Œå®šæœŸæ¸…ç†æ— æ•ˆæ•°æ®
- ç›‘æ§å…³é”®æŒ‡æ ‡ï¼Œæå‰è§„åˆ’å®¹é‡æ‰©å±•