---
title: 12、Set集合类型基础操作
---
## 📚 目录

1. [Set集合基本概念](#1-Set集合基本概念)
2. [基础成员操作](#2-基础成员操作)
3. [集合信息查询](#3-集合信息查询)
4. [随机操作详解](#4-随机操作详解)
5. [Set核心特性理解](#5-Set核心特性理解)
6. [实际应用场景](#6-实际应用场景)
7. [性能与内存分析](#7-性能与内存分析)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 Set集合基本概念


### 1.1 什么是Redis Set


**通俗理解**：Set就像一个**不重复的袋子**，你往里面放什么东西都可以，但是**相同的东西只能存一个**。

```
现实生活中的Set：
学生名单 = {"张三", "李四", "王五"}
- 每个学生姓名只能出现一次
- 没有顺序要求（不像排队）
- 可以快速检查某个学生是否在班上

Redis Set的本质：
users:online = {"user1", "user2", "user3"}
- 每个用户ID只能存储一次
- 内部无序存储
- 支持快速成员检测
```

### 1.2 Set与其他数据类型的区别


| 数据类型 | **存储特点** | **重复性** | **有序性** | **典型用途** |
|---------|------------|-----------|-----------|-------------|
| **String** | `单个值` | `不涉及` | `不涉及` | `缓存、计数器` |
| **List** | `有序列表` | `允许重复` | `有序` | `消息队列、时间线` |
| **Set** | `无序集合` | `不允许重复` | `无序` | `去重、标签、关系` |
| **Hash** | `键值对` | `键不重复，值可重复` | `无序` | `对象存储、配置` |

---

## 2. 🔧 基础成员操作


### 2.1 添加成员 - SADD


**作用**：往Set集合中添加一个或多个成员

```bash
# 基础语法
SADD key member [member ...]

# 实际示例
SADD users:online "user1"          # 添加单个用户
SADD users:online "user2" "user3"  # 添加多个用户
SADD tags:article1 "Redis" "数据库" "缓存"  # 文章标签
```

**返回值说明**：
- **成功添加的成员数量**（不包括已存在的成员）
- 如果成员已存在，不会重复添加

```bash
# 操作示例
127.0.0.1:6379> SADD users:online "user1"
(integer) 1    # 添加了1个新成员

127.0.0.1:6379> SADD users:online "user1"  
(integer) 0    # user1已存在，没有添加新成员

127.0.0.1:6379> SADD users:online "user2" "user3" "user1"
(integer) 2    # 只添加了user2和user3，user1已存在
```

### 2.2 删除成员 - SREM


**作用**：从Set集合中删除一个或多个成员

```bash
# 基础语法
SREM key member [member ...]

# 实际示例
SREM users:online "user1"           # 删除单个用户
SREM users:online "user2" "user3"   # 删除多个用户
SREM tags:article1 "过期标签"        # 删除文章标签
```

**返回值说明**：
- **成功删除的成员数量**
- 不存在的成员会被忽略

```bash
# 操作示例
127.0.0.1:6379> SREM users:online "user1"
(integer) 1    # 删除了1个成员

127.0.0.1:6379> SREM users:online "不存在的用户"
(integer) 0    # 该成员不存在，没有删除任何成员
```

### 2.3 检查成员存在 - SISMEMBER


**作用**：检查指定成员是否存在于Set中

```bash
# 基础语法
SISMEMBER key member

# 实际示例
SISMEMBER users:online "user1"      # 检查用户是否在线
SISMEMBER tags:article1 "Redis"     # 检查文章是否有Redis标签
```

**返回值说明**：
- **1**：成员存在
- **0**：成员不存在或key不存在

```bash
# 操作示例
127.0.0.1:6379> SISMEMBER users:online "user1"
(integer) 1    # user1存在于集合中

127.0.0.1:6379> SISMEMBER users:online "user999"
(integer) 0    # user999不在集合中
```

### 2.4 获取所有成员 - SMEMBERS


**作用**：获取Set集合中的所有成员

```bash
# 基础语法
SMEMBERS key

# 实际示例
SMEMBERS users:online        # 获取所有在线用户
SMEMBERS tags:article1       # 获取文章所有标签
```

**⚠️ 使用注意事项**：
- 返回结果是**无序的**
- 如果集合很大（>1000个成员），建议使用`SSCAN`
- 会一次性返回所有成员，可能影响性能

```bash
# 操作示例
127.0.0.1:6379> SMEMBERS users:online
1) "user3"
2) "user1" 
3) "user2"
# 注意：每次返回的顺序可能不同
```

---

## 3. 📊 集合信息查询


### 3.1 获取集合大小 - SCARD


**作用**：获取Set集合中成员的数量

```bash
# 基础语法
SCARD key

# 实际示例
SCARD users:online        # 获取在线用户数量
SCARD tags:article1       # 获取文章标签数量
SCARD blacklist:ip        # 获取IP黑名单数量
```

**特点说明**：
- **时间复杂度**：O(1) - 非常快
- **返回值**：集合成员数量，key不存在时返回0
- **应用场景**：统计、限流、监控

```bash
# 操作示例
127.0.0.1:6379> SCARD users:online
(integer) 3    # 当前有3个在线用户

127.0.0.1:6379> SCARD not_exists_key
(integer) 0    # key不存在，返回0
```

### 3.2 渐进式遍历 - SSCAN


**作用**：分批次遍历Set集合，适合大数据量场景

```bash
# 基础语法
SSCAN key cursor [MATCH pattern] [COUNT count]

# 实际示例
SSCAN users:online 0                    # 开始遍历
SSCAN users:online 0 COUNT 10           # 每次返回10个
SSCAN tags:all 0 MATCH "Redis*"         # 只返回Redis开头的标签
```

**参数说明**：
- **cursor**：游标，从0开始，返回的游标用于下次查询
- **MATCH pattern**：模式匹配，支持通配符
- **COUNT count**：建议返回的数量（实际可能不同）

```bash
# 操作示例
127.0.0.1:6379> SSCAN users:all 0 COUNT 2
1) "3"         # 下次查询的游标
2) 1) "user1"  # 本次返回的成员
   2) "user2"

127.0.0.1:6379> SSCAN users:all 3 COUNT 2  # 使用上次返回的游标
1) "0"         # 游标为0表示遍历完成
2) 1) "user3"
   2) "user4"
```

**💡 SSCAN vs SMEMBERS 对比**：

| 命令 | **数据量** | **性能影响** | **内存占用** | **适用场景** |
|------|-----------|-------------|-------------|-------------|
| **SMEMBERS** | `小量(<1000)` | `一次性获取` | `可能较大` | `小集合快速获取` |
| **SSCAN** | `大量(>1000)` | `分批处理` | `恒定小量` | `大集合安全遍历` |

---

## 4. 🎲 随机操作详解


### 4.1 随机获取成员 - SRANDMEMBER


**作用**：从Set中随机获取成员，**不删除**

```bash
# 基础语法
SRANDMEMBER key [count]

# 实际示例
SRANDMEMBER users:online           # 随机获取1个在线用户
SRANDMEMBER users:online 3         # 随机获取3个在线用户
SRANDMEMBER prize_pool 1           # 随机获取1个奖品
```

**count参数详解**：
- **不指定count**：返回1个随机成员
- **count > 0**：返回最多count个**不重复**的成员
- **count < 0**：返回|count|个成员，**可能重复**

```bash
# 操作示例
127.0.0.1:6379> SRANDMEMBER users:online
"user2"        # 随机返回一个用户

127.0.0.1:6379> SRANDMEMBER users:online 2
1) "user1"     # 返回2个不重复的用户
2) "user3"

127.0.0.1:6379> SRANDMEMBER users:online -5
1) "user1"     # 可能返回重复的用户
2) "user1" 
3) "user2"
4) "user3"
5) "user2"
```

### 4.2 随机弹出成员 - SPOP


**作用**：从Set中随机获取并**删除**成员

```bash
# 基础语法
SPOP key [count]

# 实际示例
SPOP lottery_pool              # 随机抽奖并移除
SPOP task_queue 3              # 随机获取3个任务
SPOP random_questions 1        # 随机出题
```

**与SRANDMEMBER的区别**：
- **SPOP**：获取后**删除**，改变集合
- **SRANDMEMBER**：获取但**不删除**，不改变集合

```bash
# 操作示例
127.0.0.1:6379> SMEMBERS lottery_pool
1) "iphone"
2) "ipad" 
3) "macbook"

127.0.0.1:6379> SPOP lottery_pool
"ipad"         # 随机获取ipad并从集合中删除

127.0.0.1:6379> SMEMBERS lottery_pool
1) "iphone"    # ipad已被删除
2) "macbook"
```

**🎯 应用场景对比**：

| 命令 | **使用场景** | **集合变化** | **典型应用** |
|------|-------------|-------------|-------------|
| **SRANDMEMBER** | `查看但不影响` | `不变` | `推荐系统、展示随机内容` |
| **SPOP** | `获取并消费` | `减少` | `抽奖系统、任务分发` |

---

## 5. ⚡ Set核心特性理解


### 5.1 无序性特点


**含义**：Set中的成员没有固定的顺序

```
理解示例：
班级花名册 = {"张三", "李四", "王五"}

每次查看可能是：
第一次：["李四", "张三", "王五"]
第二次：["王五", "李四", "张三"]
第三次：["张三", "王五", "李四"]

顺序不固定，但成员始终是这三个
```

**实际影响**：
- `SMEMBERS`每次返回顺序可能不同
- 不能通过索引访问成员（没有第1个、第2个的概念）
- 适合不关心顺序的场景

### 5.2 唯一性特点


**含义**：Set中每个成员只能存在一次

```bash
# 唯一性示例
127.0.0.1:6379> SADD users "alice" "bob" "alice" "charlie" "bob"
(integer) 3    # 只添加了3个成员：alice, bob, charlie

127.0.0.1:6379> SMEMBERS users
1) "alice"     # alice只出现一次
2) "charlie"   # charlie只出现一次  
3) "bob"       # bob只出现一次
```

**自动去重原理**：
```
添加过程：
Step 1: SADD users "alice"     → 成功添加
Step 2: SADD users "bob"       → 成功添加
Step 3: SADD users "alice"     → 已存在，忽略
Step 4: SADD users "charlie"   → 成功添加
Step 5: SADD users "bob"       → 已存在，忽略

最终结果：{"alice", "bob", "charlie"}
```

### 5.3 成员去重特点


**场景示例**：用户标签系统

```bash
# 用户给文章添加标签，可能重复添加
SADD article:1:tags "Redis"
SADD article:1:tags "数据库" 
SADD article:1:tags "Redis"        # 重复标签自动忽略
SADD article:1:tags "缓存"
SADD article:1:tags "数据库"       # 重复标签自动忽略

# 最终标签集合
SMEMBERS article:1:tags
1) "Redis"
2) "数据库"
3) "缓存"
# 自动去除了重复的标签
```

**去重优势**：
- **自动处理**：无需手动检查重复
- **节省存储**：避免冗余数据
- **提高效率**：去重逻辑内置，性能优化

---

## 6. 🚀 实际应用场景


### 6.1 数据去重


**场景**：处理用户行为数据，去除重复记录

```bash
# 记录用户访问的页面（自动去重）
SADD user:123:visited_pages "/home" "/product" "/about" "/home" "/product"

# 查看用户实际访问了多少个不同页面
SCARD user:123:visited_pages
(integer) 3    # 实际访问了3个不同页面

# 获取访问页面列表
SMEMBERS user:123:visited_pages
1) "/home"
2) "/product"  
3) "/about"
```

**应用价值**：
- **数据清洗**：自动去除重复行为记录
- **统计分析**：准确计算独立访问数
- **节省存储**：避免重复数据占用空间

### 6.2 简单标签系统


**场景**：文章或商品的标签管理

```bash
# 文章标签管理
SADD article:100:tags "Redis" "数据库" "NoSQL" "缓存"
SADD article:100:tags "性能优化"    # 添加新标签

# 检查文章是否包含某个标签
SISMEMBER article:100:tags "Redis"
(integer) 1    # 包含Redis标签

# 删除过时标签
SREM article:100:tags "过时标签"

# 获取文章所有标签
SMEMBERS article:100:tags
1) "Redis"
2) "数据库"
3) "NoSQL" 
4) "缓存"
5) "性能优化"
```

**系统架构示例**：
```
文章标签系统架构：
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   文章1     │    │   文章2     │    │   文章3     │
│ tags: Redis │    │ tags: Java  │    │ tags: MySQL │
│       数据库 │    │       算法   │    │       SQL   │
│       缓存   │    │       面试   │    │       查询   │
└─────────────┘    └─────────────┘    └─────────────┘
       ↓                  ↓                  ↓
┌─────────────────────────────────────────────────────┐
│          标签搜索索引                                │
│    Redis标签 → {article:1}                         │
│    数据库标签 → {article:1}                         │
│    Java标签  → {article:2}                         │
│    MySQL标签 → {article:3}                         │
└─────────────────────────────────────────────────────┘
```

### 6.3 唯一性校验


**场景1**：用户名唯一性检查

```bash
# 注册时检查用户名是否已被使用
SISMEMBER registered_usernames "alice123"
(integer) 0    # 用户名可用

# 注册成功后添加用户名
SADD registered_usernames "alice123"
(integer) 1    # 添加成功

# 再次检查（模拟其他用户注册相同用户名）
SISMEMBER registered_usernames "alice123"  
(integer) 1    # 用户名已被使用
```

**场景2**：邮箱唯一性校验

```bash
# 邮箱注册系统
SISMEMBER registered_emails "user@example.com"
(integer) 0    # 邮箱可用

SADD registered_emails "user@example.com"
(integer) 1    # 注册成功

# 统计注册用户数
SCARD registered_emails
(integer) 1    # 当前1个注册用户
```

**优势分析**：
- **高效检查**：O(1)时间复杂度
- **自动去重**：避免重复注册
- **简单实现**：无需复杂逻辑判断

---

## 7. 📈 性能与内存分析


### 7.1 时间复杂度分析


| 操作 | **时间复杂度** | **说明** |
|------|--------------|---------|
| **SADD** | `O(1)` | `添加单个成员` |
| **SREM** | `O(1)` | `删除单个成员` |
| **SISMEMBER** | `O(1)` | `检查成员存在` |
| **SCARD** | `O(1)` | `获取集合大小` |
| **SMEMBERS** | `O(N)` | `N为集合大小` |
| **SRANDMEMBER** | `O(1)` | `随机获取` |
| **SPOP** | `O(1)` | `随机弹出` |
| **SSCAN** | `O(1)` | `单次扫描` |

### 7.2 内存效率分析


**内存占用特点**：
- **基础开销**：每个Set有固定的数据结构开销
- **成员存储**：每个成员占用内存 = 字符串长度 + 指针开销
- **哈希表**：内部使用哈希表，有一定的内存冗余

**内存优化建议**：
```bash
# ❌ 内存浪费的用法
SADD user_tags:1 "非常长的标签名称包含很多无用信息和重复词汇"

# ✅ 内存高效的用法  
SADD user_tags:1 "Redis" "DB" "Cache"   # 使用简短的标签
```

### 7.3 性能最佳实践


**🔥 高频操作优化**：
```bash
# 批量操作比单次操作更高效
# ❌ 低效方式
SADD users "user1"
SADD users "user2" 
SADD users "user3"

# ✅ 高效方式
SADD users "user1" "user2" "user3"
```

**⚡ 大集合处理**：
```bash
# ❌ 大集合使用SMEMBERS（可能阻塞）
SMEMBERS huge_set    # 如果集合有100万个成员

# ✅ 大集合使用SSCAN（安全遍历）
SSCAN huge_set 0 COUNT 100
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本操作

```
🔸 SADD：添加成员到集合，自动去重
🔸 SREM：从集合删除成员
🔸 SISMEMBER：检查成员是否存在（O(1)高效）
🔸 SMEMBERS：获取所有成员（小集合使用）
🔸 SCARD：获取集合大小（O(1)高效）
🔸 SSCAN：安全遍历大集合
```

### 8.2 Set集合核心特性

```
✅ 唯一性：每个成员只能存在一次，自动去重
✅ 无序性：成员无固定顺序，每次获取可能不同
✅ 高效性：基本操作都是O(1)时间复杂度
✅ 灵活性：支持随机操作，适合多种场景
```

### 8.3 典型应用场景记忆

```
🎯 数据去重：用户行为、访问记录自动去重
🏷️ 标签系统：文章标签、商品分类管理  
✅ 唯一性校验：用户名、邮箱重复检查
🎲 随机抽取：抽奖系统、随机推荐
👥 关系管理：关注列表、好友系统
```

### 8.4 性能优化要点

```
💡 小集合(<1000)：使用SMEMBERS快速获取
💡 大集合(>1000)：使用SSCAN分批处理
💡 批量操作：一次SADD多个成员比多次SADD效率高
💡 内存优化：使用简短的成员名称节省内存
```

**💭 记忆口诀**：
```
Set集合不重复，无序存储很独特
SADD添加SREM删，SISMEMBER查存在
SMEMBERS取全部，SCARD获取大小值
随机操作两兄弟，SRANDMEMBER不删除
SPOP弹出会删除，应用场景要记住
去重标签和校验，唯一性是大特点
```