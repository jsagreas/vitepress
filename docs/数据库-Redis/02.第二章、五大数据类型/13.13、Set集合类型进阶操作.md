---
title: 13ã€Seté›†åˆç±»å‹è¿›é˜¶æ“ä½œ
---
## ğŸ“š ç›®å½•

1. [Seté›†åˆè¿ç®—åŸºç¡€](#1-Seté›†åˆè¿ç®—åŸºç¡€)
2. [é›†åˆè¿ç®—æ“ä½œè¯¦è§£](#2-é›†åˆè¿ç®—æ“ä½œè¯¦è§£)
3. [é›†åˆè¿ç®—ç»“æœå­˜å‚¨](#3-é›†åˆè¿ç®—ç»“æœå­˜å‚¨)
4. [é›†åˆè¿ç®—å®é™…åº”ç”¨](#4-é›†åˆè¿ç®—å®é™…åº”ç”¨)
5. [æ€§èƒ½ä¼˜åŒ–æŠ€å·§](#5-æ€§èƒ½ä¼˜åŒ–æŠ€å·§)
6. [è¿›é˜¶åº”ç”¨åœºæ™¯](#6-è¿›é˜¶åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Seté›†åˆè¿ç®—åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯é›†åˆè¿ç®—


**ç®€å•ç†è§£**ï¼šé›†åˆè¿ç®—å°±åƒå°å­¦æ•°å­¦é‡Œå­¦çš„**éŸ¦æ©å›¾**ï¼ŒæŠŠä¸¤ä¸ªåœ†åœˆç”»åœ¨ä¸€èµ·ï¼Œçœ‹å®ƒä»¬é‡å ã€ç»„åˆçš„éƒ¨åˆ†ã€‚

```
æƒ³è±¡ä¸¤ä¸ªæœ‹å‹åœˆï¼š
å¼ ä¸‰çš„æœ‹å‹ï¼š{å°æ˜, å°çº¢, å°åˆš, å°ä¸½}
æå››çš„æœ‹å‹ï¼š{å°çº¢, å°åˆš, å°å, å°ç‹}

äº¤é›†ï¼ˆå…±åŒæœ‹å‹ï¼‰ï¼š{å°çº¢, å°åˆš}
å¹¶é›†ï¼ˆæ‰€æœ‰æœ‹å‹ï¼‰ï¼š{å°æ˜, å°çº¢, å°åˆš, å°ä¸½, å°å, å°ç‹}  
å·®é›†ï¼ˆå¼ ä¸‰ç‹¬æœ‰ï¼‰ï¼š{å°æ˜, å°ä¸½}
```

### 1.2 Redisä¸­çš„ä¸‰ç§é›†åˆè¿ç®—


**ğŸ”¸ äº¤é›†ï¼ˆSINTERï¼‰**ï¼šä¸¤ä¸ªé›†åˆçš„**å…±åŒéƒ¨åˆ†**
```
é›†åˆA: 1, 2, 3, 4
é›†åˆB: 3, 4, 5, 6
äº¤é›†ç»“æœ: 3, 4
```

**ğŸ”¸ å¹¶é›†ï¼ˆSUNIONï¼‰**ï¼šä¸¤ä¸ªé›†åˆçš„**å…¨éƒ¨å…ƒç´ **ï¼ˆå»é‡ï¼‰
```
é›†åˆA: 1, 2, 3, 4
é›†åˆB: 3, 4, 5, 6
å¹¶é›†ç»“æœ: 1, 2, 3, 4, 5, 6
```

**ğŸ”¸ å·®é›†ï¼ˆSDIFFï¼‰**ï¼šç¬¬ä¸€ä¸ªé›†åˆ**ç‹¬æœ‰çš„å…ƒç´ **
```
é›†åˆA: 1, 2, 3, 4
é›†åˆB: 3, 4, 5, 6
å·®é›†ç»“æœ: 1, 2  (Aæœ‰ä½†Bæ²¡æœ‰çš„)
```

### 1.3 é›†åˆè¿ç®—çš„å®é™…æ„ä¹‰


| è¿ç®—ç±»å‹ | **ç”Ÿæ´»åœºæ™¯** | **ç³»ç»Ÿåº”ç”¨** |
|---------|------------|-------------|
| **äº¤é›†** | `æ‰¾å…±åŒçˆ±å¥½çš„æœ‹å‹` | `ç”¨æˆ·å…±åŒæ ‡ç­¾åˆ†æ` |
| **å¹¶é›†** | `åˆå¹¶æ‰€æœ‰æœ‹å‹åœˆ` | `æ•°æ®å»é‡åˆå¹¶` |
| **å·®é›†** | `æ‰¾ç‹¬æœ‰çš„ç‰¹å¾` | `æƒé™å·®å¼‚åˆ†æ` |

---

## 2. âš™ï¸ é›†åˆè¿ç®—æ“ä½œè¯¦è§£


### 2.1 äº¤é›†è¿ç®— - SINTER


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```bash
SINTER key1 key2 [key3 ...]
```

**ğŸ”¸ å®é™…æ“ä½œç¤ºä¾‹**
```bash
# åˆ›å»ºæµ‹è¯•æ•°æ®
SADD users:online user1 user2 user3 user4
SADD users:vip user2 user3 user5 user6

# æŸ¥æ‰¾åœ¨çº¿çš„VIPç”¨æˆ·ï¼ˆäº¤é›†ï¼‰
SINTER users:online users:vip
# ç»“æœ: user2, user3

# å¤šä¸ªé›†åˆäº¤é›†
SADD users:active user2 user7 user8
SINTER users:online users:vip users:active
# ç»“æœ: user2  (ä¸‰ä¸ªé›†åˆå…±æœ‰çš„ç”¨æˆ·)
```

**ğŸ’¡ äº¤é›†çš„é€šä¿—ç†è§£**ï¼š
- å°±åƒæ‰¾"**æ—¢åœ¨çº¿åˆæ˜¯VIP**"çš„ç”¨æˆ·
- æ‰€æœ‰æ¡ä»¶éƒ½è¦æ»¡è¶³çš„å…ƒç´ 
- ç±»ä¼¼æ•°æ®åº“çš„ `AND` æ¡ä»¶

### 2.2 å¹¶é›†è¿ç®— - SUNION


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```bash
SUNION key1 key2 [key3 ...]
```

**ğŸ”¸ å®é™…æ“ä½œç¤ºä¾‹**
```bash
# åˆ›å»ºä¸åŒæ¸ é“çš„ç”¨æˆ·
SADD users:web user1 user2 user3
SADD users:mobile user3 user4 user5

# è·å–æ‰€æœ‰æ¸ é“çš„ç”¨æˆ·ï¼ˆå¹¶é›†ï¼‰
SUNION users:web users:mobile
# ç»“æœ: user1, user2, user3, user4, user5

# æŸ¥çœ‹æ€»æ•°
SUNION users:web users:mobile | wc -l
```

**ğŸ’¡ å¹¶é›†çš„é€šä¿—ç†è§£**ï¼š
- å°±åƒæŠŠæ‰€æœ‰ç”¨æˆ·"**åˆå¹¶å»é‡**"
- ä¸ç®¡æ¥è‡ªå“ªä¸ªæ¸ é“ï¼Œåªè¦æ˜¯ç”¨æˆ·å°±è¦
- ç±»ä¼¼æ•°æ®åº“çš„ `OR` æ¡ä»¶

### 2.3 å·®é›†è¿ç®— - SDIFF


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```bash
SDIFF key1 key2 [key3 ...]
```

**ğŸ”¸ å®é™…æ“ä½œç¤ºä¾‹**
```bash
# åˆ›å»ºç”¨æˆ·æ•°æ®
SADD users:all user1 user2 user3 user4 user5
SADD users:banned user2 user4

# æ‰¾å‡ºæ­£å¸¸ç”¨æˆ·ï¼ˆå·®é›†ï¼‰
SDIFF users:all users:banned
# ç»“æœ: user1, user3, user5

# æ‰¾å‡ºä»Šå¤©æ–°å¢ç”¨æˆ·
SADD users:yesterday user1 user2 user3
SADD users:today user1 user2 user3 user4 user5
SDIFF users:today users:yesterday
# ç»“æœ: user4, user5  (ä»Šå¤©æœ‰ä½†æ˜¨å¤©æ²¡æœ‰çš„)
```

**ğŸ’¡ å·®é›†çš„é€šä¿—ç†è§£**ï¼š
- å°±åƒä»ç¬¬ä¸€ä¸ªé›†åˆä¸­"**æ’é™¤**"ç¬¬äºŒä¸ªé›†åˆçš„å…ƒç´ 
- Aæœ‰ä½†Bæ²¡æœ‰çš„éƒ¨åˆ†
- æ³¨æ„é¡ºåºå¾ˆé‡è¦ï¼`SDIFF A B` â‰  `SDIFF B A`

### 2.4 è¿ç®—ç»“æœçš„ç‰¹ç‚¹


```
é‡è¦ç‰¹æ€§è¯´æ˜ï¼š

äº¤é›†ç»“æœ â‰¤ min(é›†åˆAå¤§å°, é›†åˆBå¤§å°)
å¹¶é›†ç»“æœ â‰¤ é›†åˆAå¤§å° + é›†åˆBå¤§å°
å·®é›†ç»“æœ â‰¤ ç¬¬ä¸€ä¸ªé›†åˆå¤§å°

ç¤ºä¾‹éªŒè¯ï¼š
A = {1,2,3}  (3ä¸ªå…ƒç´ )
B = {2,3,4}  (3ä¸ªå…ƒç´ )

äº¤é›† = {2,3}     (2ä¸ªå…ƒç´  â‰¤ min(3,3))
å¹¶é›† = {1,2,3,4} (4ä¸ªå…ƒç´  â‰¤ 3+3)  
å·®é›† = {1}       (1ä¸ªå…ƒç´  â‰¤ 3)
```

---

## 3. ğŸ’¾ é›†åˆè¿ç®—ç»“æœå­˜å‚¨


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦å­˜å‚¨ç»“æœ


**ğŸ¤” é—®é¢˜åœºæ™¯**ï¼š
```
å‡è®¾ä½ è¦æ‰¾"åœ¨çº¿ä¸”VIPä¸”æ´»è·ƒ"çš„ç”¨æˆ·ï¼Œæ¯æ¬¡éƒ½è¦è¿ç®—ï¼š
SINTER users:online users:vip users:active

å¦‚æœè¿™ä¸ªç»“æœè¦è¢«å¤šæ¬¡ä½¿ç”¨ï¼Œæ¯æ¬¡è¿ç®—éƒ½æµªè´¹æ—¶é—´ï¼
```

**ğŸ’¡ è§£å†³æ–¹æ¡ˆ**ï¼šæŠŠè¿ç®—ç»“æœç›´æ¥å­˜åˆ°æ–°çš„é›†åˆé‡Œ

### 3.2 äº¤é›†ç»“æœå­˜å‚¨ - SINTERSTORE


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```bash
SINTERSTORE destination key1 key2 [key3 ...]
```

**ğŸ”¸ å®é™…åº”ç”¨**
```bash
# æ‰¾å‡ºåœ¨çº¿VIPç”¨æˆ·å¹¶ä¿å­˜ç»“æœ
SINTERSTORE users:online_vip users:online users:vip
# è¿”å›: 2  (è¡¨ç¤ºäº¤é›†æœ‰2ä¸ªå…ƒç´ )

# æŸ¥çœ‹å­˜å‚¨çš„ç»“æœ
SMEMBERS users:online_vip
# ç»“æœ: user2, user3

# è®¾ç½®ç»“æœçš„è¿‡æœŸæ—¶é—´ï¼ˆ1å°æ—¶åå¤±æ•ˆï¼‰
EXPIRE users:online_vip 3600
```

### 3.3 å¹¶é›†ç»“æœå­˜å‚¨ - SUNIONSTORE


**ğŸ”¸ å®é™…åº”ç”¨**
```bash
# åˆå¹¶å¤šä¸ªæ¨èåˆ—è¡¨
SADD recommend:hot item1 item2 item3
SADD recommend:new item3 item4 item5
SADD recommend:personal item5 item6 item7

# ç”Ÿæˆç»¼åˆæ¨èåˆ—è¡¨
SUNIONSTORE recommend:final recommend:hot recommend:new recommend:personal
# ç»“æœä¿å­˜åœ¨ recommend:final ä¸­

# æŸ¥çœ‹æœ€ç»ˆæ¨è
SMEMBERS recommend:final
# ç»“æœ: item1, item2, item3, item4, item5, item6, item7
```

### 3.4 å·®é›†ç»“æœå­˜å‚¨ - SDIFFSTORE


**ğŸ”¸ å®é™…åº”ç”¨**
```bash
# æ‰¾å‡ºéœ€è¦æ¨é€æ¶ˆæ¯çš„ç”¨æˆ·
SADD users:all user1 user2 user3 user4 user5
SADD users:already_notified user2 user4

# ç”Ÿæˆå¾…é€šçŸ¥ç”¨æˆ·åˆ—è¡¨
SDIFFSTORE users:need_notify users:all users:already_notified
# ç»“æœ: 3  (æœ‰3ä¸ªç”¨æˆ·éœ€è¦é€šçŸ¥)

# æ‰¹é‡å¤„ç†è¿™äº›ç”¨æˆ·
SMEMBERS users:need_notify
# ç»“æœ: user1, user3, user5
```

### 3.5 å­˜å‚¨æ“ä½œçš„ä¼˜åŠ¿


| ä¼˜åŠ¿ | **è¯´æ˜** | **åœºæ™¯ä¸¾ä¾‹** |
|------|---------|-------------|
| **æ€§èƒ½æå‡** | `é¿å…é‡å¤è¿ç®—` | `çƒ­é—¨æ•°æ®é¢‘ç¹æŸ¥è¯¢` |
| **ç»“æœå¤ç”¨** | `ä¸€æ¬¡è®¡ç®—å¤šæ¬¡ä½¿ç”¨` | `æ¨èåˆ—è¡¨ç”Ÿæˆ` |
| **åŸå­æ“ä½œ** | `è¿ç®—å’Œå­˜å‚¨ä¸€æ¬¡å®Œæˆ` | `é¿å…å¹¶å‘é—®é¢˜` |
| **è¿‡æœŸæ§åˆ¶** | `ç»“æœå¯è®¾ç½®TTL` | `ä¸´æ—¶åˆ†æç»“æœ` |

---

## 4. ğŸš€ é›†åˆè¿ç®—å®é™…åº”ç”¨


### 4.1 æ•°æ®å…³è”åˆ†æ


**ğŸ“Š ç”¨æˆ·è¡Œä¸ºåˆ†æ**
```bash
# åˆ†æç”¨æˆ·è´­ä¹°è¡Œä¸º
SADD products:electronics user1 user2 user3 user4
SADD products:books user2 user3 user5 user6
SADD products:sports user3 user4 user6 user7

# æ‰¾å‡ºè·¨å“ç±»è´­ä¹°ç”¨æˆ·ï¼ˆéƒ½ä¹°ç”µå­äº§å“å’Œå›¾ä¹¦ï¼‰
SINTERSTORE users:cross_category products:electronics products:books
# ç»“æœ: user2, user3

# æ‰¾å‡ºåªä¹°ç”µå­äº§å“çš„ç”¨æˆ·
SDIFFSTORE users:electronics_only products:electronics products:books
# ç»“æœ: user1, user4
```

**ğŸ“ˆ è¥é”€æ•ˆæœåˆ†æ**
```bash
# ä¸åŒè¥é”€æ¸ é“çš„ç”¨æˆ·
SADD channel:email user1 user2 user3
SADD channel:sms user2 user3 user4
SADD channel:push user3 user4 user5

# åˆ†æå¤šæ¸ é“è§¦è¾¾æ•ˆæœ
SINTER channel:email channel:sms channel:push
# ç»“æœ: user3  (è¢«ä¸‰ä¸ªæ¸ é“éƒ½è§¦è¾¾çš„ç”¨æˆ·)

# åªè¢«é‚®ä»¶è§¦è¾¾çš„ç”¨æˆ·
SDIFF channel:email channel:sms channel:push
```

### 4.2 ç”¨æˆ·å…³ç³»è®¡ç®—


**ğŸ‘¥ å¥½å‹å…³ç³»åˆ†æ**
```bash
# ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨
SADD friends:user1 friend1 friend2 friend3 friend4
SADD friends:user2 friend2 friend3 friend5 friend6

# æ‰¾å…±åŒå¥½å‹
SINTERSTORE common:user1_user2 friends:user1 friends:user2
# ç»“æœä¿å­˜å…±åŒå¥½å‹

# æ¨èå¯èƒ½è®¤è¯†çš„äººï¼ˆuser1å¥½å‹çš„å¥½å‹ä½†ä¸æ˜¯user1çš„å¥½å‹ï¼‰
SADD friends:friend2 user2 friend7 friend8
SDIFF friends:friend2 friends:user1
# å¯èƒ½æ¨èç»™user1çš„å¥½å‹
```

**ğŸ” æƒé™ç³»ç»Ÿè®¾è®¡**
```bash
# ç”¨æˆ·æ‹¥æœ‰çš„æƒé™
SADD perms:user1 read write delete
SADD perms:admin read write delete execute manage

# è§’è‰²éœ€è¦çš„æƒé™
SADD role:editor read write
SADD role:viewer read

# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ»¡è¶³è§’è‰²è¦æ±‚
SINTER perms:user1 role:editor
# å¦‚æœç»“æœç­‰äºrole:editorçš„æ‰€æœ‰æƒé™ï¼Œè¯´æ˜æ»¡è¶³è¦æ±‚
```

### 4.3 æ ‡ç­¾äº¤å‰åˆ†æ


**ğŸ·ï¸ å†…å®¹æ ‡ç­¾åˆ†æ**
```bash
# æ–‡ç« æ ‡ç­¾
SADD article:1001:tags tech redis database
SADD article:1002:tags tech python programming  
SADD article:1003:tags redis database optimization

# æ‰¾åŒæ—¶åŒ…å«ç‰¹å®šæ ‡ç­¾çš„æ–‡ç« 
SADD filter:tags tech redis
# è‡ªå®šä¹‰å‡½æ•°ï¼šæ‰¾åŒ…å«æŒ‡å®šæ ‡ç­¾çš„æ–‡ç« 
for article in articles:
    if SINTER article:tags filter:tags çš„ç»“æœç­‰äº filter:tags:
        # æ–‡ç« åŒ…å«æ‰€æœ‰æŒ‡å®šæ ‡ç­¾
```

**ğŸ“Š ç”¨æˆ·ç”»åƒåˆ†æ**
```bash
# ç”¨æˆ·å…´è¶£æ ‡ç­¾
SADD user:1001:interests tech sports music
SADD user:1002:interests tech gaming music
SADD user:1003:interests sports fitness music

# åˆ†æç”¨æˆ·ç¾¤ä½“ç‰¹å¾
SINTER user:1001:interests user:1002:interests user:1003:interests
# ç»“æœ: music  (ä¸‰äººå…±åŒå…´è¶£)

# ä¸ºç”¨æˆ·æ¨èç›¸ä¼¼ç”¨æˆ·
SUNIONSTORE similar:user1001 user:1001:interests user:1002:interests
SDIFF similar:user1001 user:1001:interests
# å¾—åˆ°å¯èƒ½æ„Ÿå…´è¶£ä½†è¿˜æ²¡æœ‰çš„æ ‡ç­¾
```

---

## 5. âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§


### 5.1 å¤§é›†åˆè¿ç®—ä¼˜åŒ–


**ğŸ”¸ è¿ç®—é¡ºåºä¼˜åŒ–**
```bash
# âŒ ä½æ•ˆï¼šå¤§é›†åˆæ”¾åœ¨å‰é¢
SINTER large_set(100ä¸‡å…ƒç´ ) small_set(100å…ƒç´ )

# âœ… é«˜æ•ˆï¼šå°é›†åˆæ”¾åœ¨å‰é¢  
SINTER small_set(100å…ƒç´ ) large_set(100ä¸‡å…ƒç´ )

# åŸç†ï¼šRedisä¼šä¼˜åŒ–ï¼Œå…ˆå¤„ç†å°é›†åˆ
```

**ğŸ”¸ åˆ†æ‰¹å¤„ç†ç­–ç•¥**
```bash
# å¯¹äºè¶…å¤§é›†åˆï¼Œè€ƒè™‘åˆ†æ‰¹å¤„ç†
# ä¸è¦ä¸€æ¬¡è¿ç®—å‡ åƒä¸‡å…ƒç´ çš„é›†åˆ

# ç¤ºä¾‹ï¼šåˆ†æ‰¹æ‰¾äº¤é›†
for batch in batches:
    SINTERSTORE temp:batch_{i} set1:batch_{i} set2:batch_{i}
    
# æœ€ååˆå¹¶æ‰€æœ‰æ‰¹æ¬¡ç»“æœ
SUNIONSTORE final:result temp:batch_1 temp:batch_2 ...
```

### 5.2 å†…å­˜ä½¿ç”¨æ§åˆ¶


**ğŸ’¾ å†…å­˜ç›‘æ§**
```bash
# æŸ¥çœ‹é›†åˆå ç”¨å†…å­˜
MEMORY USAGE users:online
# è¿”å›å­—èŠ‚æ•°

# æŸ¥çœ‹é›†åˆå¤§å°
SCARD users:online
# è¿”å›å…ƒç´ æ•°é‡

# ä¼°ç®—è¿ç®—ç»“æœå¤§å°
SINTER users:online users:vip --dry-run  # (å‡æƒ³å‘½ä»¤ï¼Œå®é™…ä¸å­˜åœ¨)
```

**ğŸ”¸ å†…å­˜ä¼˜åŒ–æŠ€å·§**
```
1. åŠæ—¶æ¸…ç†ä¸´æ—¶ç»“æœé›†åˆ
2. ä¸ºè¿ç®—ç»“æœè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
3. é¿å…å­˜å‚¨è¿‡å¤§çš„è¿ç®—ç»“æœ
4. ä½¿ç”¨æ›´ç´§å‡‘çš„æ•°æ®è¡¨ç¤º
```

### 5.3 è¿ç®—ç»“æœç¼“å­˜


**âš¡ ç¼“å­˜ç­–ç•¥**
```bash
# å¯¹äºé¢‘ç¹ä½¿ç”¨çš„è¿ç®—ç»“æœï¼Œè®¾ç½®ç¼“å­˜
SINTERSTORE cache:online_vip users:online users:vip
EXPIRE cache:online_vip 300  # ç¼“å­˜5åˆ†é’Ÿ

# ä½¿ç”¨æ—¶å…ˆæ£€æŸ¥ç¼“å­˜
if EXISTS cache:online_vip:
    result = SMEMBERS cache:online_vip
else:
    result = SINTER users:online users:vip
    # å¯é€‰ï¼šå­˜å‚¨ç»“æœå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”**

| æ“ä½œç±»å‹ | **æ— ç¼“å­˜è€—æ—¶** | **æœ‰ç¼“å­˜è€—æ—¶** | **æ€§èƒ½æå‡** |
|---------|-------------|-------------|-------------|
| `å°é›†åˆäº¤é›†` | `1-2ms` | `0.1ms` | `10-20å€` |
| `å¤§é›†åˆäº¤é›†` | `10-100ms` | `0.1ms` | `100-1000å€` |
| `å¤æ‚è¿ç®—` | `100-1000ms` | `0.1ms` | `1000+å€` |

---

## 6. ğŸ¨ è¿›é˜¶åº”ç”¨åœºæ™¯


### 6.1 å¥½å‹å…³ç³»ç®¡ç†


**ğŸ‘¥ ç¤¾äº¤ç½‘ç»œåŠŸèƒ½**
```bash
# å®Œæ•´çš„å¥½å‹å…³ç³»ç³»ç»Ÿ
class FriendSystem:
    
    # æ·»åŠ å¥½å‹å…³ç³»ï¼ˆåŒå‘ï¼‰
    def add_friend(user1, user2):
        SADD friends:{user1} {user2}
        SADD friends:{user2} {user1}
    
    # è·å–å…±åŒå¥½å‹
    def get_common_friends(user1, user2):
        return SINTER friends:{user1} friends:{user2}
    
    # æ¨èå¥½å‹ï¼ˆäºŒåº¦äººè„‰ï¼‰
    def recommend_friends(user):
        # å¥½å‹çš„å¥½å‹ï¼Œä½†ä¸æ˜¯è‡ªå·±çš„å¥½å‹
        friends = SMEMBERS friends:{user}
        candidates = SET()
        for friend in friends:
            friend_friends = SMEMBERS friends:{friend}
            candidates.update(friend_friends)
        
        # æ’é™¤è‡ªå·±å’Œå·²æœ‰å¥½å‹
        SDIFFSTORE recommend:{user} candidates friends:{user}
        SREM recommend:{user} {user}  # æ’é™¤è‡ªå·±
        
        return SMEMBERS recommend:{user}
```

**å®é™…ä»£ç åº”ç”¨**ï¼š
```python
# Pythonä¸­çš„åº”ç”¨ç¤ºä¾‹
import redis

r = redis.Redis()

# æ‰¾å…±åŒå¥½å‹æ•°æœ€å¤šçš„ç”¨æˆ·å¯¹
def find_best_friends():
    users = ['user1', 'user2', 'user3', 'user4']
    best_pair = None
    max_common = 0
    
    for i, user1 in enumerate(users):
        for user2 in users[i+1:]:
            common_count = r.sintercard(f'friends:{user1}', f'friends:{user2}')
            if common_count > max_common:
                max_common = common_count
                best_pair = (user1, user2)
    
    return best_pair, max_common
```

### 6.2 æƒé™ç³»ç»Ÿè®¾è®¡


**ğŸ” RBACæƒé™æ¨¡å‹**
```bash
# åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
# ç”¨æˆ·è§’è‰²
SADD user:admin:roles admin editor viewer
SADD user:john:roles editor viewer  
SADD user:mary:roles viewer

# è§’è‰²æƒé™
SADD role:admin:perms read write delete manage execute
SADD role:editor:perms read write
SADD role:viewer:perms read

# æ£€æŸ¥ç”¨æˆ·æƒé™ï¼ˆè·å–ç”¨æˆ·æ‰€æœ‰æƒé™ï¼‰
def get_user_permissions(user):
    user_roles = SMEMBERS user:{user}:roles
    all_perms = SET()
    for role in user_roles:
        role_perms = SMEMBERS role:{role}:perms
        all_perms = SUNION all_perms role_perms
    return all_perms

# æƒé™æ£€æŸ¥
def check_permission(user, required_perm):
    user_perms = get_user_permissions(user)
    return required_perm in user_perms
```

**ğŸ”¸ æƒé™ç»§æ‰¿ç³»ç»Ÿ**
```bash
# éƒ¨é—¨æƒé™ç»§æ‰¿
SADD dept:engineering:perms deploy debug review
SADD dept:marketing:perms publish analyze

# ç”¨æˆ·ç»§æ‰¿éƒ¨é—¨æƒé™
def get_effective_permissions(user):
    # ä¸ªäººæƒé™
    personal_perms = SMEMBERS user:{user}:perms
    
    # éƒ¨é—¨æƒé™  
    user_dept = GET user:{user}:department
    dept_perms = SMEMBERS dept:{user_dept}:perms
    
    # åˆå¹¶æƒé™
    return SUNION personal_perms dept_perms
```

### 6.3 æ•°æ®åˆ†æç»Ÿè®¡


**ğŸ“Š ç”¨æˆ·è¡Œä¸ºåˆ†æ**
```bash
# ç”¨æˆ·æ´»åŠ¨åˆ†æç³»ç»Ÿ
class UserAnalytics:
    
    # è®°å½•ç”¨æˆ·è¡Œä¸º
    def track_action(user, action, date):
        SADD users:{action}:{date} {user}
    
    # åˆ†ææ´»è·ƒç”¨æˆ·è¶‹åŠ¿
    def analyze_activity_trend():
        today = SMEMBERS users:login:2025-01-28
        yesterday = SMEMBERS users:login:2025-01-27
        
        # æ–°å¢æ´»è·ƒç”¨æˆ·
        new_active = SDIFF today yesterday
        
        # æµå¤±ç”¨æˆ·  
        lost_users = SDIFF yesterday today
        
        # æŒç»­æ´»è·ƒç”¨æˆ·
        retained = SINTER today yesterday
        
        return {
            'new': len(new_active),
            'lost': len(lost_users), 
            'retained': len(retained)
        }
```

**ğŸ¯ A/Bæµ‹è¯•åˆ†æ**
```bash
# A/Bæµ‹è¯•æ•ˆæœåˆ†æ
SADD experiment:groupA user1 user2 user3 user4
SADD experiment:groupB user5 user6 user7 user8

# è½¬åŒ–ç”¨æˆ·
SADD converted:users user1 user3 user5 user7

# åˆ†æå„ç»„è½¬åŒ–ç‡
groupA_converted = SINTER experiment:groupA converted:users
groupB_converted = SINTER experiment:groupB converted:users

# è®¡ç®—è½¬åŒ–ç‡
groupA_rate = len(groupA_converted) / SCARD experiment:groupA
groupB_rate = len(groupB_converted) / SCARD experiment:groupB
```

**ğŸ“ˆ æ ‡ç­¾æ¨èç³»ç»Ÿ**
```bash
# åŸºäºç”¨æˆ·è¡Œä¸ºçš„æ ‡ç­¾æ¨è
def recommend_tags(user):
    # ç”¨æˆ·å½“å‰æ ‡ç­¾
    user_tags = SMEMBERS user:{user}:tags
    
    # æ‰¾ç›¸ä¼¼ç”¨æˆ·ï¼ˆæœ‰å…±åŒæ ‡ç­¾çš„ç”¨æˆ·ï¼‰
    similar_users = SET()
    for tag in user_tags:
        tag_users = SMEMBERS tag:{tag}:users
        similar_users.update(tag_users)
    
    # ç»Ÿè®¡ç›¸ä¼¼ç”¨æˆ·çš„å…¶ä»–æ ‡ç­¾
    recommended_tags = SET()
    for similar_user in similar_users:
        if similar_user != user:
            other_tags = SMEMBERS user:{similar_user}:tags
            recommended_tags.update(other_tags)
    
    # æ’é™¤ç”¨æˆ·å·²æœ‰æ ‡ç­¾
    return SDIFF recommended_tags user_tags
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é›†åˆè¿ç®—æœ¬è´¨ï¼šæ•°å­¦ä¸­çš„äº¤é›†ã€å¹¶é›†ã€å·®é›†åœ¨Redisä¸­çš„å®ç°
ğŸ”¸ ä¸‰å¤§åŸºæœ¬æ“ä½œï¼šSINTER(äº¤é›†)ã€SUNION(å¹¶é›†)ã€SDIFF(å·®é›†)
ğŸ”¸ ç»“æœå­˜å‚¨æ“ä½œï¼šSINTERSTOREã€SUNIONSTOREã€SDIFFSTORE
ğŸ”¸ è¿ç®—ç‰¹æ€§ï¼šäº¤é›†â‰¤æœ€å°é›†åˆï¼Œå¹¶é›†â‰¤é›†åˆä¹‹å’Œï¼Œå·®é›†â‰¤ç¬¬ä¸€é›†åˆ
ğŸ”¸ åº”ç”¨åœºæ™¯ï¼šå¥½å‹å…³ç³»ã€æƒé™ç³»ç»Ÿã€æ•°æ®åˆ†æã€ç”¨æˆ·ç”»åƒ
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é›†åˆè¿ç®—çš„å®é™…æ„ä¹‰**
```
ä¸åªæ˜¯æ•°å­¦æ¦‚å¿µï¼Œæ›´æ˜¯è§£å†³å®é™…é—®é¢˜çš„å·¥å…·ï¼š
- äº¤é›† = æ‰¾å…±åŒç‰¹å¾ = ç²¾å‡†ç­›é€‰
- å¹¶é›† = æ•°æ®åˆå¹¶ = å»é‡æ•´åˆ  
- å·®é›† = æ‰¾å·®å¼‚ = å¯¹æ¯”åˆ†æ
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–åŸåˆ™**
```
1. å°é›†åˆä¼˜å…ˆï¼šè¿ç®—æ—¶å°é›†åˆæ”¾å‰é¢
2. ç»“æœç¼“å­˜ï¼šé¢‘ç¹ä½¿ç”¨çš„ç»“æœè¦ç¼“å­˜
3. åŠæ—¶æ¸…ç†ï¼šä¸´æ—¶ç»“æœåŠæ—¶åˆ é™¤
4. æ‰¹é‡å¤„ç†ï¼šè¶…å¤§é›†åˆè¦åˆ†æ‰¹è¿ç®—
```

**ğŸ”¹ å­˜å‚¨ vs å³æ—¶è¿ç®—çš„é€‰æ‹©**
```
ç«‹å³ä½¿ç”¨ â†’ ç›´æ¥è¿ç®—ï¼ˆSINTERã€SUNIONã€SDIFFï¼‰
å¤šæ¬¡å¤ç”¨ â†’ å­˜å‚¨ç»“æœï¼ˆSINTERSTOREã€SUNIONSTOREã€SDIFFSTOREï¼‰
ä¸´æ—¶åˆ†æ â†’ å­˜å‚¨+è®¾ç½®è¿‡æœŸæ—¶é—´
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç”µå•†ç³»ç»Ÿ**ï¼šç”¨æˆ·æ ‡ç­¾åˆ†æï¼Œå•†å“æ¨èï¼Œè¥é”€äººç¾¤ç­›é€‰
- **ç¤¾äº¤ç½‘ç»œ**ï¼šå¥½å‹æ¨èï¼Œå…±åŒå…´è¶£ï¼Œç”¨æˆ·åˆ†ç¾¤
- **å†…å®¹å¹³å°**ï¼šæ ‡ç­¾äº¤å‰ï¼Œå†…å®¹æ¨èï¼Œç”¨æˆ·ç”»åƒ
- **æƒé™ç®¡ç†**ï¼šè§’è‰²æƒé™ï¼Œèµ„æºè®¿é—®æ§åˆ¶ï¼Œå®‰å…¨å®¡è®¡

**ğŸ”§ æŠ€æœ¯å®è·µè¦ç‚¹**
- **æ•°æ®å»ºæ¨¡**ï¼šåˆç†è®¾è®¡é›†åˆç»“æ„ï¼Œä¾¿äºè¿ç®—
- **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§è¿ç®—è€—æ—¶ï¼Œä¼˜åŒ–æ…¢æŸ¥è¯¢
- **å†…å­˜ç®¡ç†**ï¼šæ§åˆ¶é›†åˆå¤§å°ï¼Œé¿å…å†…å­˜æº¢å‡º
- **ä¸šåŠ¡é€»è¾‘**ï¼šå°†å¤æ‚ä¸šåŠ¡é€»è¾‘è½¬åŒ–ä¸ºé›†åˆè¿ç®—

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
äº¤é›†æ‰¾å…±åŒï¼Œå¹¶é›†å…¨åˆå¹¶
å·®é›†çœ‹å·®å¼‚ï¼Œå­˜å‚¨å¯å¤ç”¨
å°é›†åˆä¼˜å…ˆï¼Œç¼“å­˜ææ€§èƒ½
ä¸šåŠ¡å·§å»ºæ¨¡ï¼Œè¿ç®—è§£éš¾é¢˜
```

### 7.4 å¸¸è§åº”ç”¨æ¨¡å¼


| æ¨¡å¼ç±»å‹ | **è¿ç®—ç»„åˆ** | **å…¸å‹åœºæ™¯** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|-------------|
| **ç­›é€‰æ¨¡å¼** | `å¤šä¸ªäº¤é›†` | `ç²¾å‡†ç”¨æˆ·å®šä½` | `æ³¨æ„é›†åˆå¤§å°é¡ºåº` |
| **åˆå¹¶æ¨¡å¼** | `å¤šä¸ªå¹¶é›†` | `æ•°æ®æºæ•´åˆ` | `æ§åˆ¶ç»“æœé›†å¤§å°` |
| **å¯¹æ¯”æ¨¡å¼** | `å·®é›†åˆ†æ` | `å¢é‡æ•°æ®åˆ†æ` | `æ³¨æ„æ“ä½œé¡ºåº` |
| **æ··åˆæ¨¡å¼** | `äº¤å¹¶å·®ç»„åˆ` | `å¤æ‚ä¸šåŠ¡é€»è¾‘` | `åˆ†æ­¥éª¤å­˜å‚¨ä¸­é—´ç»“æœ` |