---
title: 5ã€æ•…éšœæ’æŸ¥å’Œé—®é¢˜è§£å†³æ‰‹å†Œ
---
## ğŸ“š ç›®å½•

1. [æ•…éšœæ’æŸ¥åŸºç¡€ç†è®º](#1-æ•…éšœæ’æŸ¥åŸºç¡€ç†è®º)
2. [æ ¸å¿ƒæ•…éšœç±»å‹æ·±åº¦è§£æ](#2-æ ¸å¿ƒæ•…éšœç±»å‹æ·±åº¦è§£æ)
3. [æ•…éšœæ’æŸ¥æŠ€æœ¯æ‰‹æ®µ](#3-æ•…éšœæ’æŸ¥æŠ€æœ¯æ‰‹æ®µ)
4. [åº”æ€¥å¤„ç†å’Œæ•…éšœæ¢å¤](#4-åº”æ€¥å¤„ç†å’Œæ•…éšœæ¢å¤)
5. [ç³»ç»Ÿä¼˜åŒ–å’Œé¢„é˜²æªæ–½](#5-ç³»ç»Ÿä¼˜åŒ–å’Œé¢„é˜²æªæ–½)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ•…éšœæ’æŸ¥åŸºç¡€ç†è®º


### 1.1 æ•…éšœæ’æŸ¥æ–¹æ³•è®º


**ä»€ä¹ˆæ˜¯ç³»ç»Ÿæ€§çš„æ•…éšœæ’æŸ¥ï¼Ÿ**

æ•…éšœæ’æŸ¥ä¸æ˜¯ç›²ç›®è¯•é”™ï¼Œè€Œæ˜¯æœ‰ç« æ³•çš„ç³»ç»Ÿæ€§åˆ†æè¿‡ç¨‹ã€‚å°±åƒåŒ»ç”Ÿçœ‹ç—…è¦å…ˆæœ›é—»é—®åˆ‡ï¼ŒRedisæ•…éšœæ’æŸ¥ä¹Ÿæœ‰å›ºå®šçš„æ€è·¯ã€‚

**ğŸ” æ’æŸ¥æ€ç»´æ¨¡å‹**

```
é—®é¢˜å®šä¹‰é˜¶æ®µ
    â†“
ç°è±¡æ”¶é›†é˜¶æ®µ â†’ å¿«é€Ÿæ¢å¤æœåŠ¡
    â†“              â†“
åŸå› åˆ†æé˜¶æ®µ    ä¸´æ—¶æªæ–½
    â†“              â†“  
æ ¹æœ¬è§£å†³é˜¶æ®µ    æ°¸ä¹…æ–¹æ¡ˆ
    â†“              â†“
é¢„é˜²ä¼˜åŒ–é˜¶æ®µ    æŒç»­æ”¹è¿›
```

### 1.2 æ•…éšœæ’æŸ¥æµç¨‹


**ğŸ“ æ ‡å‡†åŒ–æ’æŸ¥æ­¥éª¤**

```java
// æ•…éšœæ’æŸ¥æ ‡å‡†æµç¨‹
public class TroubleshootingProcess {
    
    // ç¬¬1æ­¥ï¼šå¿«é€Ÿæ”¶é›†åŸºç¡€ä¿¡æ¯
    public void step1_CollectBasicInfo() {
        // RedisåŸºæœ¬çŠ¶æ€
        redis.info();
        redis.ping();
        
        // ç³»ç»Ÿèµ„æºçŠ¶æ€
        checkMemoryUsage();
        checkCpuUsage();
        checkNetworkStatus();
    }
    
    // ç¬¬2æ­¥ï¼šå®šä½é—®é¢˜èŒƒå›´
    public void step2_LocateProblem() {
        // æ˜¯å•ç‚¹æ•…éšœè¿˜æ˜¯é›†ç¾¤é—®é¢˜ï¼Ÿ
        // æ˜¯æ€§èƒ½é—®é¢˜è¿˜æ˜¯åŠŸèƒ½é—®é¢˜ï¼Ÿ
        // å½±å“èŒƒå›´æœ‰å¤šå¤§ï¼Ÿ
    }
    
    // ç¬¬3æ­¥ï¼šæ·±å…¥åˆ†æåŸå› 
    public void step3_AnalyzeRoot() {
        // æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
        // åˆ†æç›‘æ§æŒ‡æ ‡
        // æ‰§è¡Œè¯Šæ–­å‘½ä»¤
    }
    
    // ç¬¬4æ­¥ï¼šåˆ¶å®šè§£å†³æ–¹æ¡ˆ
    public void step4_CreateSolution() {
        // ä¸´æ—¶æªæ–½ï¼šå¿«é€Ÿæ¢å¤æœåŠ¡
        // æ ¹æœ¬æ–¹æ¡ˆï¼šå½»åº•è§£å†³é—®é¢˜
        // é¢„é˜²æªæ–½ï¼šé¿å…å†æ¬¡å‘ç”Ÿ
    }
}
```

### 1.3 æ•…éšœåˆ†ç±»å’Œç‰¹å¾è¯†åˆ«


**ğŸ“Š æ•…éšœåˆ†ç±»çŸ©é˜µ**

| æ•…éšœç±»å‹ | **ä¸»è¦ç‰¹å¾** | **å½±å“èŒƒå›´** | **ç´§æ€¥ç¨‹åº¦** |
|---------|------------|-------------|-------------|
| **å†…å­˜æ•…éšœ** | `å†…å­˜ä½¿ç”¨ç‡>90%ï¼ŒOOMé”™è¯¯` | `å…¨éƒ¨æœåŠ¡` | `ğŸ”¥ æé«˜` |
| **è¿æ¥æ•…éšœ** | `è¿æ¥è¶…æ—¶ï¼Œè¿æ¥è¢«æ‹’ç»` | `æ–°è¯·æ±‚` | `ğŸ”¥ é«˜` |
| **æ€§èƒ½æ•…éšœ** | `å“åº”æ—¶é—´>100msï¼ŒCPU>80%` | `å…¨éƒ¨è¯·æ±‚` | `âš¡ ä¸­é«˜` |
| **æ•°æ®æ•…éšœ** | `æ•°æ®ä¸¢å¤±ï¼Œæ•°æ®ä¸ä¸€è‡´` | `ä¸šåŠ¡æ•°æ®` | `ğŸ”¥ æé«˜` |
| **åŒæ­¥æ•…éšœ** | `ä¸»ä»å»¶è¿Ÿ>1sï¼ŒåŒæ­¥å¤±è´¥` | `è¯»å†™åˆ†ç¦»` | `âš¡ ä¸­` |

> ğŸ’¡ **æ•…éšœä¼˜å…ˆçº§åŸåˆ™**ï¼šæ•°æ®å®‰å…¨ > æœåŠ¡å¯ç”¨ > æ€§èƒ½ä½“éªŒ

---

## 2. ğŸš¨ æ ¸å¿ƒæ•…éšœç±»å‹æ·±åº¦è§£æ


### 2.1 å†…å­˜ç›¸å…³æ•…éšœ


#### å†…å­˜å ç”¨è¿‡é«˜é—®é¢˜


**ğŸ¤” ä¸ºä»€ä¹ˆä¼šå†…å­˜å ç”¨è¿‡é«˜ï¼Ÿ**

Redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€æœ‰æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ã€‚å°±åƒæ°´æ¯è£…æ°´ï¼Œè£…æ»¡äº†å°±æº¢å‡ºï¼ŒRediså†…å­˜æ»¡äº†å°±ä¼šæŠ¥é”™æˆ–æ¸…ç†æ•°æ®ã€‚

**ğŸ“Š å†…å­˜å ç”¨è¿‡é«˜çš„å¸¸è§åŸå› **

```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
redis-cli info memory

# å…³é”®æŒ‡æ ‡è§£è¯»ï¼š
used_memory:1073741824        # å·²ä½¿ç”¨å†…å­˜ 1GB
maxmemory:2147483648          # æœ€å¤§å¯ç”¨å†…å­˜ 2GB  
used_memory_peak:1200000000   # å†å²æœ€é«˜ä½¿ç”¨ 1.2GB
mem_fragmentation_ratio:1.05  # å†…å­˜ç¢ç‰‡ç‡
```

**ğŸ”§ å†…å­˜é—®é¢˜æ’æŸ¥æ­¥éª¤**

```bash
# 1. æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„key
redis-cli --bigkeys

# 2. åˆ†æå†…å­˜ä½¿ç”¨åˆ†å¸ƒ
redis-cli memory usage key_name

# 3. æ£€æŸ¥è¿‡æœŸkeyæ¸…ç†æƒ…å†µ  
redis-cli info stats | grep expired

# 4. æŸ¥çœ‹å†…å­˜å›æ”¶ç­–ç•¥
redis-cli config get maxmemory-policy
```

**ğŸ’Š å†…å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ**

```java
public class MemoryOptimization {
    
    // æ–¹æ¡ˆ1ï¼šæ¸…ç†è¿‡æœŸæ•°æ®
    public void cleanupExpiredData() {
        // æ‰‹åŠ¨è§¦å‘è¿‡æœŸkeyæ¸…ç†
        jedis.eval("return redis.call('DEL', unpack(redis.call('KEYS', ARGV[1])))", 
                   0, "*:temp:*");  // æ¸…ç†ä¸´æ—¶æ•°æ®
    }
    
    // æ–¹æ¡ˆ2ï¼šä¼˜åŒ–æ•°æ®ç»“æ„
    public void optimizeDataStructure() {
        // ç”¨Hashæ›¿ä»£å¤šä¸ªString key
        // åŸæ¥ï¼šuser:1001:name, user:1001:age, user:1001:email (3ä¸ªkey)
        // ä¼˜åŒ–ï¼šuser:1001 -> Hash {name, age, email} (1ä¸ªkey)
        
        Map<String, String> userInfo = new HashMap<>();
        userInfo.put("name", "å¼ ä¸‰");
        userInfo.put("age", "25");
        jedis.hmset("user:1001", userInfo);
    }
    
    // æ–¹æ¡ˆ3ï¼šè®¾ç½®åˆç†è¿‡æœŸæ—¶é—´
    public void setReasonableExpire() {
        // æ ¹æ®æ•°æ®é‡è¦æ€§è®¾ç½®ä¸åŒè¿‡æœŸæ—¶é—´
        jedis.setex("session:" + sessionId, 1800, sessionData);     // 30åˆ†é’Ÿ
        jedis.setex("captcha:" + phone, 300, code);                 // 5åˆ†é’Ÿ  
        jedis.setex("cache:" + productId, 3600, productJson);       // 1å°æ—¶
    }
}
```

#### å†…å­˜æ³„æ¼æ’æŸ¥æŠ€æœ¯


**ğŸ” å†…å­˜æ³„æ¼çš„è¯†åˆ«æ–¹æ³•**

å†…å­˜æ³„æ¼å°±æ˜¯å†…å­˜ä½¿ç”¨é‡æŒç»­å¢é•¿ä½†ä¸ä¸‹é™ï¼Œå°±åƒæ°´æ¡¶åº•éƒ¨æœ‰ä¸ªæ´ä½†ä¸€ç›´åœ¨æ³¨æ°´ã€‚

```bash
# ç›‘æ§å†…å­˜å¢é•¿è¶‹åŠ¿
redis-cli info memory | grep used_memory:
# æ¯éš”1å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼Œè¿ç»­è§‚å¯Ÿ24å°æ—¶

# æ£€æŸ¥æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyæ•°é‡
redis-cli eval "return #redis.call('keys', '*')" 0
redis-cli eval "local keys=redis.call('keys','*'); local count=0; for i=1,#keys do if redis.call('ttl',keys[i])==-1 then count=count+1 end end return count" 0
```

### 2.2 è¿æ¥ç›¸å…³æ•…éšœ


#### è¿æ¥è¶…æ—¶å¤„ç†


**â° è¿æ¥è¶…æ—¶æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ**

è¿æ¥è¶…æ—¶å°±åƒæ‰“ç”µè¯æ‰“ä¸é€šï¼Œå¯èƒ½æ˜¯å¯¹æ–¹å¿™çº¿ï¼Œä¹Ÿå¯èƒ½æ˜¯ç½‘ç»œä¸å¥½ã€‚Redisè¿æ¥è¶…æ—¶é€šå¸¸æœ‰å‡ ä¸ªåŸå› ã€‚

**ğŸ” è¿æ¥è¶…æ—¶æ’æŸ¥æ–¹æ³•**

```bash
# æ£€æŸ¥å½“å‰è¿æ¥æ•°
redis-cli info clients
# connected_clients:100     å½“å‰è¿æ¥æ•°
# maxclients:10000          æœ€å¤§è¿æ¥æ•°

# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping redis-server-ip
telnet redis-server-ip 6379

# æ£€æŸ¥Redisæ˜¯å¦å“åº”
redis-cli ping
```

**ğŸ› ï¸ è¿æ¥æ± é…ç½®ä¼˜åŒ–**

```java
// Jedisè¿æ¥æ± é…ç½®
public JedisPoolConfig createPoolConfig() {
    JedisPoolConfig config = new JedisPoolConfig();
    
    // è¿æ¥æ± å¤§å°é…ç½®
    config.setMaxTotal(200);        // æœ€å¤§è¿æ¥æ•°
    config.setMaxIdle(50);          // æœ€å¤§ç©ºé—²è¿æ¥
    config.setMinIdle(10);          // æœ€å°ç©ºé—²è¿æ¥
    
    // è¶…æ—¶é…ç½®
    config.setMaxWaitMillis(3000);  // è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´
    
    // å¥åº·æ£€æŸ¥
    config.setTestOnBorrow(true);   // å€Ÿç”¨æ—¶æ£€æŸ¥è¿æ¥æœ‰æ•ˆæ€§
    config.setTestWhileIdle(true);  // ç©ºé—²æ—¶æ£€æŸ¥è¿æ¥æœ‰æ•ˆæ€§
    
    return config;
}
```

#### è¿æ¥æ•°è¿‡å¤šè§£å†³æ–¹æ¡ˆ


**ğŸ“ˆ è¿æ¥æ•°æš´å¢çš„å¤„ç†**

```java
public class ConnectionManager {
    
    // è¿æ¥æ•°ç›‘æ§
    public void monitorConnections() {
        String clientInfo = jedis.info("clients");
        int currentConnections = parseConnectedClients(clientInfo);
        
        if (currentConnections > 8000) { // 80%é˜ˆå€¼å‘Šè­¦
            handleTooManyConnections();
        }
    }
    
    // å¤„ç†è¿æ¥è¿‡å¤š
    private void handleTooManyConnections() {
        // 1. æŸ¥çœ‹è¿æ¥æ¥æº
        String clientList = jedis.clientList();
        
        // 2. å…³é—­ç©ºé—²è¿æ¥
        jedis.eval("local clients = redis.call('client', 'list')" +
                   "for client in clients:gmatch('[^\r\n]+') do " +
                   "if client:match('idle=([0-9]+)') > '300' then " +
                   "redis.call('client', 'kill', 'id', client:match('id=([0-9]+)')) " +
                   "end end", 0);
                   
        // 3. ä¸´æ—¶é™ä½maxclients
        jedis.configSet("maxclients", "5000");
    }
}
```

### 2.3 æ€§èƒ½ç›¸å…³æ•…éšœ


#### Rediså“åº”æ…¢åˆ†æ


**ğŸŒ å“åº”æ…¢çš„æ ¹æœ¬åŸå› **

Rediså“åº”æ…¢å°±åƒé¤å…ä¸Šèœæ…¢ï¼Œå¯èƒ½æ˜¯å¨å¸ˆå¿™ä¸è¿‡æ¥ï¼Œä¹Ÿå¯èƒ½æ˜¯æŸé“èœç‰¹åˆ«å¤æ‚ã€‚

**ğŸ•µï¸ å“åº”æ…¢æ’æŸ¥æµç¨‹**

```bash
# 1. æ£€æŸ¥æ…¢æŸ¥è¯¢
redis-cli slowlog get 10
# æŸ¥çœ‹æœ€è¿‘10æ¡æ…¢æŸ¥è¯¢ï¼Œé»˜è®¤>10msçš„æŸ¥è¯¢

# 2. æ£€æŸ¥å¤§key
redis-cli --bigkeys --i 0.01
# æ‰¾å‡ºå ç”¨å†…å­˜è¾ƒå¤§çš„key

# 3. æ£€æŸ¥å‘½ä»¤æ‰§è¡Œæ—¶é—´
redis-cli --latency -i 1
# å®æ—¶ç›‘æ§Rediså“åº”å»¶è¿Ÿ

# 4. æ£€æŸ¥æ˜¯å¦æœ‰é˜»å¡å‘½ä»¤
redis-cli monitor | grep -E "(KEYS|FLUSHDB|FLUSHALL)"
```

**âš¡ æ€§èƒ½ä¼˜åŒ–å®æˆ˜**

```java
public class PerformanceOptimizer {
    
    // ä¼˜åŒ–1ï¼šé¿å…å¤§keyæ“ä½œ
    public void avoidBigKeys() {
        // âŒ é”™è¯¯ï¼šä¸€æ¬¡è·å–å¤§é‡æ•°æ®
        // Set<String> bigSet = jedis.smembers("big_set"); // å¯èƒ½æœ‰100ä¸‡å…ƒç´ 
        
        // âœ… æ­£ç¡®ï¼šåˆ†æ‰¹è·å–æ•°æ®
        ScanParams params = new ScanParams().count(100);
        String cursor = "0";
        do {
            ScanResult<String> result = jedis.sscan("big_set", cursor, params);
            List<String> members = result.getResult();
            processBatch(members); // å¤„ç†è¿™ä¸€æ‰¹æ•°æ®
            cursor = result.getStringCursor();
        } while (!"0".equals(cursor));
    }
    
    // ä¼˜åŒ–2ï¼šä½¿ç”¨pipelineæ‰¹é‡æ“ä½œ
    public void usePipeline() {
        Pipeline pipeline = jedis.pipelined();
        
        // æ‰¹é‡è®¾ç½®å¤šä¸ªkey
        for (int i = 0; i < 1000; i++) {
            pipeline.set("key:" + i, "value:" + i);
        }
        
        pipeline.sync(); // ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
    }
}
```

#### CPUä½¿ç”¨ç‡é«˜åˆ†æ


**ğŸ”¥ CPUé£™é«˜çš„å¸¸è§åœºæ™¯**

```bash
# æ£€æŸ¥CPUä½¿ç”¨æƒ…å†µ
top -p `pgrep redis-server`

# æ£€æŸ¥Rediså†…éƒ¨CPUç»Ÿè®¡
redis-cli info cpu
# used_cpu_sys:10.36        ç³»ç»ŸCPUæ—¶é—´
# used_cpu_user:4.12        ç”¨æˆ·CPUæ—¶é—´
```

**ğŸ¯ CPUé—®é¢˜å®šä½æ–¹æ³•**

```
CPUé£™é«˜çš„å…¸å‹åŸå› ï¼š

1. å¤§keyæ“ä½œï¼š
   KEYS * å‘½ä»¤æ‰«æå¤§é‡key
   å¤§Hashã€å¤§Setçš„éå†æ“ä½œ
   
2. å¤æ‚è®¡ç®—ï¼š
   å¤æ‚çš„Luaè„šæœ¬
   å¤§é‡çš„é›†åˆè¿ç®—
   
3. æŒä¹…åŒ–å‹åŠ›ï¼š
   BGSAVE during fork
   AOF rewriteæ“ä½œ
   
4. ç½‘ç»œIOå¯†é›†ï¼š
   å¤§é‡çš„å°è¯·æ±‚
   ç½‘ç»œå¸¦å®½è·‘æ»¡
```

**ğŸ”§ CPUé—®é¢˜è§£å†³æ–¹æ¡ˆ**

```java
// CPUä¼˜åŒ–ç­–ç•¥
public class CpuOptimization {
    
    // é¿å…å…¨é‡æ‰«æ
    public List<String> findKeys(String pattern) {
        List<String> keys = new ArrayList<>();
        ScanParams params = new ScanParams()
            .match(pattern)
            .count(100);
            
        String cursor = "0";
        do {
            ScanResult<String> result = jedis.scan(cursor, params);
            keys.addAll(result.getResult());
            cursor = result.getStringCursor();
        } while (!"0".equals(cursor));
        
        return keys;
    }
    
    // ä¼˜åŒ–æŒä¹…åŒ–é…ç½®
    public void optimizePersistence() {
        // è°ƒæ•´BGSAVEé¢‘ç‡
        jedis.configSet("save", "900 1 300 10 60 10000");
        
        // ä¼˜åŒ–AOFé…ç½®
        jedis.configSet("appendfsync", "everysec"); // æ¯ç§’åŒæ­¥ä¸€æ¬¡
        jedis.configSet("auto-aof-rewrite-percentage", "100");
        jedis.configSet("auto-aof-rewrite-min-size", "64mb");
    }
}
```

### 2.4 æ•°æ®ç›¸å…³æ•…éšœ


#### æ•°æ®ä¸¢å¤±é—®é¢˜åˆ†æ


**ğŸ’” æ•°æ®ä¸¢å¤±çš„å¯æ€•åœºæ™¯**

æ•°æ®ä¸¢å¤±æ˜¯æœ€ä¸¥é‡çš„æ•…éšœï¼Œå°±åƒé“¶è¡Œè´¦æˆ·ä½™é¢çªç„¶æ¶ˆå¤±ã€‚Redisè™½ç„¶æ˜¯å†…å­˜æ•°æ®åº“ï¼Œä½†é€šè¿‡æŒä¹…åŒ–æœºåˆ¶å¯ä»¥ä¿è¯æ•°æ®å®‰å…¨ã€‚

**ğŸ” æ•°æ®ä¸¢å¤±åŸå› åˆ†æ**

```
å¸¸è§æ•°æ®ä¸¢å¤±åœºæ™¯ï¼š

1. æœåŠ¡å™¨å®•æœºï¼š
   - Redisè¿›ç¨‹å´©æºƒ
   - æ“ä½œç³»ç»Ÿé‡å¯
   - ç¡¬ä»¶æ•…éšœ

2. è¯¯æ“ä½œï¼š
   - FLUSHDB / FLUSHALLå‘½ä»¤
   - DELå‘½ä»¤è¯¯åˆ é‡è¦key
   - é”™è¯¯çš„expireè®¾ç½®

3. æŒä¹…åŒ–å¤±æ•ˆï¼š
   - RDBæ–‡ä»¶æŸå
   - AOFæ–‡ä»¶æˆªæ–­
   - ç£ç›˜ç©ºé—´ä¸è¶³

4. ä¸»ä»åˆ‡æ¢ï¼š
   - ç½‘ç»œåˆ†åŒºå¯¼è‡´è„‘è£‚
   - ä»åº“æ•°æ®æ»å
   - åˆ‡æ¢æ—¶æœºä¸å½“
```

**ğŸ›¡ï¸ æ•°æ®æ¢å¤æµç¨‹**

```bash
#!/bin/bash
# æ•°æ®æ¢å¤æ ‡å‡†æµç¨‹

# ç¬¬1æ­¥ï¼šåœæ­¢RedisæœåŠ¡ï¼ˆé˜²æ­¢æ•°æ®è¢«è¦†ç›–ï¼‰
systemctl stop redis

# ç¬¬2æ­¥ï¼šå¤‡ä»½å½“å‰çŠ¶æ€
cp /var/lib/redis/dump.rdb /backup/dump.rdb.$(date +%Y%m%d_%H%M%S)
cp /var/lib/redis/appendonly.aof /backup/appendonly.aof.$(date +%Y%m%d_%H%M%S)

# ç¬¬3æ­¥ï¼šå°è¯•ä»å¤‡ä»½æ¢å¤
if [ -f "/backup/latest/dump.rdb" ]; then
    cp /backup/latest/dump.rdb /var/lib/redis/
    echo "ä»RDBå¤‡ä»½æ¢å¤"
elif [ -f "/backup/latest/appendonly.aof" ]; then
    cp /backup/latest/appendonly.aof /var/lib/redis/
    echo "ä»AOFå¤‡ä»½æ¢å¤"
fi

# ç¬¬4æ­¥ï¼šå¯åŠ¨Rediså¹¶éªŒè¯æ•°æ®
systemctl start redis
redis-cli ping
redis-cli dbsize  # æ£€æŸ¥æ¢å¤çš„æ•°æ®é‡
```

#### æ•°æ®ä¸ä¸€è‡´å¤„ç†


**ğŸ”„ ä¸»ä»æ•°æ®ä¸ä¸€è‡´æ’æŸ¥**

```java
public class DataConsistencyChecker {
    
    // æ£€æŸ¥ä¸»ä»æ•°æ®ä¸€è‡´æ€§
    public void checkMasterSlaveConsistency() {
        Jedis master = new Jedis("master-host", 6379);
        Jedis slave = new Jedis("slave-host", 6379);
        
        // æ£€æŸ¥å…³é”®ä¸šåŠ¡æ•°æ®
        List<String> keyPatterns = Arrays.asList("user:*", "order:*", "product:*");
        
        for (String pattern : keyPatterns) {
            Set<String> masterKeys = master.keys(pattern);
            for (String key : masterKeys) {
                String masterValue = master.get(key);
                String slaveValue = slave.get(key);
                
                if (!Objects.equals(masterValue, slaveValue)) {
                    handleInconsistentData(key, masterValue, slaveValue);
                }
            }
        }
    }
    
    // å¤„ç†æ•°æ®ä¸ä¸€è‡´
    private void handleInconsistentData(String key, String masterValue, String slaveValue) {
        // è®°å½•ä¸ä¸€è‡´çš„æ•°æ®
        logger.error("æ•°æ®ä¸ä¸€è‡´ key={}, master={}, slave={}", key, masterValue, slaveValue);
        
        // å¼ºåˆ¶ä»åº“é‡æ–°åŒæ­¥
        if (isCriticalData(key)) {
            Jedis slave = getSlaveConnection();
            slave.flushdb(); // æ¸…ç©ºä»åº“
            slave.slaveof("master-ip", 6379); // é‡æ–°å¼€å§‹å…¨é‡åŒæ­¥
        }
    }
}
```

### 2.5 é›†ç¾¤åŒæ­¥æ•…éšœ


#### ä¸»ä»å»¶è¿Ÿæ’æŸ¥


**ğŸŒ ä¸»ä»å»¶è¿Ÿæ˜¯ä»€ä¹ˆï¼Ÿ**

ä¸»ä»å»¶è¿Ÿå°±åƒè€å¸ˆåœ¨é»‘æ¿ä¸Šå†™å­—ï¼Œåæ’åŒå­¦çœ‹åˆ°å†…å®¹æ¯”å‰æ’åŒå­¦æ™šå‡ ç§’ã€‚åœ¨Redisä¸­å°±æ˜¯ä»åº“çš„æ•°æ®æ¯”ä¸»åº“æ…¢ã€‚

**ğŸ“ å»¶è¿Ÿæ£€æµ‹æ–¹æ³•**

```bash
# æ£€æŸ¥ä¸»ä»å»¶è¿Ÿ
redis-cli -h slave-host info replication
# master_last_io_seconds_ago:2    # æœ€åä¸€æ¬¡ä¸ä¸»åº“é€šä¿¡æ—¶é—´
# master_sync_in_progress:0       # æ˜¯å¦æ­£åœ¨åŒæ­¥

# æ£€æŸ¥å¤åˆ¶ç¼“å†²åŒº
redis-cli -h master-host info replication  
# repl_backlog_size:1048576       # å¤åˆ¶ç¼“å†²åŒºå¤§å°
# repl_backlog_first_byte_offset  # ç¼“å†²åŒºé¦–å­—èŠ‚ä½ç½®
```

**ğŸ”§ ä¸»ä»å»¶è¿Ÿè§£å†³æ–¹æ¡ˆ**

```java
public class ReplicationOptimizer {
    
    // ä¼˜åŒ–ä¸»ä»åŒæ­¥é…ç½®
    public void optimizeReplication() {
        Jedis master = getMasterConnection();
        
        // è°ƒæ•´å¤åˆ¶ç¼“å†²åŒºå¤§å°
        master.configSet("repl-backlog-size", "10mb");
        
        // è°ƒæ•´å¤åˆ¶è¶…æ—¶æ—¶é—´
        master.configSet("repl-timeout", "30");
        
        // ä¼˜åŒ–ç½‘ç»œé…ç½®
        master.configSet("tcp-keepalive", "60");
    }
    
    // ç›‘æ§ä¸»ä»å»¶è¿Ÿ
    public long measureReplicationLag() {
        Jedis master = getMasterConnection();
        Jedis slave = getSlaveConnection();
        
        // åœ¨ä¸»åº“å†™å…¥æ—¶é—´æˆ³
        String timestamp = String.valueOf(System.currentTimeMillis());
        master.set("lag_test", timestamp);
        
        // ç­‰å¾…ä»åº“åŒæ­¥
        Thread.sleep(100);
        
        // ä»ä»åº“è¯»å–
        String slaveTimestamp = slave.get("lag_test");
        if (slaveTimestamp != null) {
            return System.currentTimeMillis() - Long.parseLong(slaveTimestamp);
        }
        
        return -1; // åŒæ­¥å¤±è´¥
    }
}
```

---

## 3. ğŸ” æ•…éšœæ’æŸ¥æŠ€æœ¯æ‰‹æ®µ


### 3.1 æ—¥å¿—åˆ†ææŠ€å·§


**ğŸ“„ Redisæ—¥å¿—åˆ†ææŠ€å·§**

Redisæ—¥å¿—æ˜¯æ•…éšœæ’æŸ¥çš„é‡è¦çº¿ç´¢ï¼Œå°±åƒçŠ¯ç½ªç°åœºçš„è¯æ®ï¼Œéœ€è¦ä»”ç»†åˆ†ææ¯ä¸€æ¡ä¿¡æ¯ã€‚

**ğŸ“Š æ—¥å¿—çº§åˆ«å’Œå†…å®¹**

```bash
# Redisæ—¥å¿—é…ç½®
redis-cli config set loglevel notice

# æ—¥å¿—çº§åˆ«è¯´æ˜ï¼š
# debugï¼šè¯¦ç»†ä¿¡æ¯ï¼Œç”¨äºå¼€å‘è°ƒè¯•
# verboseï¼šè¾ƒè¯¦ç»†ä¿¡æ¯  
# noticeï¼šé‡è¦ä¿¡æ¯ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
# warningï¼šè­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯
```

**ğŸ” å…³é”®æ—¥å¿—ä¿¡æ¯æå–**

```bash
# åˆ†æRedisæ—¥å¿—çš„å¸¸ç”¨å‘½ä»¤
tail -f /var/log/redis/redis.log

# æå–é”™è¯¯ä¿¡æ¯
grep "ERROR\|WARNING" /var/log/redis/redis.log

# åˆ†æå†…å­˜ç›¸å…³æ—¥å¿—
grep "Out of memory\|OOM\|evicted" /var/log/redis/redis.log

# åˆ†æè¿æ¥ç›¸å…³æ—¥å¿—  
grep "Connection\|timeout\|refused" /var/log/redis/redis.log

# åˆ†ææŒä¹…åŒ–ç›¸å…³æ—¥å¿—
grep "Background saving\|AOF\|RDB" /var/log/redis/redis.log
```

### 3.2 ç›‘æ§è¯Šæ–­å·¥å…·


#### æ€§èƒ½ç›‘æ§å·¥å…·ä½¿ç”¨


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**

```bash
# redis-cliå†…ç½®ç›‘æ§å·¥å…·
redis-cli --stat -i 1    # æ¯ç§’æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
redis-cli --latency       # å»¶è¿Ÿç›‘æ§
redis-cli --latency-history -i 1  # å»¶è¿Ÿå†å²

# è¾“å‡ºç¤ºä¾‹ï¼š
------- data ------ --------------------- load -------------------- - child -
keys       mem      clients blocked requests            connections
1000000   1.20G        100       0  1500000 (+1000)           50
```

**ğŸ¯ è‡ªå®šä¹‰ç›‘æ§è„šæœ¬**

```python
#!/usr/bin/env python3
import redis
import time
import json

class RedisMonitor:
    def __init__(self, host='localhost', port=6379):
        self.r = redis.Redis(host=host, port=port, decode_responses=True)
    
    def collect_metrics(self):
        info = self.r.info()
        
        metrics = {
            'timestamp': int(time.time()),
            'memory': {
                'used': info.get('used_memory'),
                'max': info.get('maxmemory'),
                'fragmentation': info.get('mem_fragmentation_ratio')
            },
            'clients': {
                'connected': info.get('connected_clients'),
                'blocked': info.get('blocked_clients')
            },
            'performance': {
                'ops_per_sec': info.get('instantaneous_ops_per_sec'),
                'hit_rate': self.calculate_hit_rate(info)
            }
        }
        
        return metrics
    
    def calculate_hit_rate(self, info):
        hits = info.get('keyspace_hits', 0)
        misses = info.get('keyspace_misses', 0)
        if hits + misses == 0:
            return 0
        return hits / (hits + misses) * 100
```

#### æŒ‡æ ‡ç›‘æ§åˆ†æ


**ğŸ“ˆ æ ¸å¿ƒç›‘æ§æŒ‡æ ‡è§£è¯»**

| æŒ‡æ ‡ç±»åˆ« | **å…³é”®æŒ‡æ ‡** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|---------|------------|-------------|-------------|
| **å†…å­˜** | `å†…å­˜ä½¿ç”¨ç‡` | `<70%` | `>85%` |
| **æ€§èƒ½** | `QPS(æ¯ç§’æŸ¥è¯¢)` | `10000-50000` | `>80000` |
| **å»¶è¿Ÿ** | `å¹³å‡å“åº”æ—¶é—´` | `<1ms` | `>10ms` |
| **è¿æ¥** | `å®¢æˆ·ç«¯è¿æ¥æ•°` | `<500` | `>8000` |
| **ç¼“å­˜** | `ç¼“å­˜å‘½ä¸­ç‡` | `>90%` | `<80%` |

---

## 4. ğŸš‘ åº”æ€¥å¤„ç†å’Œæ•…éšœæ¢å¤


### 4.1 åº”æ€¥å“åº”æµç¨‹


**âš¡ æ•…éšœåº”æ€¥å¤„ç†æ ‡å‡†æµç¨‹**

```
æ•…éšœå‘ç”Ÿ
    â†“
[5åˆ†é’Ÿ] å¿«é€Ÿè¯„ä¼°å½±å“èŒƒå›´
    â†“
[10åˆ†é’Ÿ] å¯åŠ¨ä¸´æ—¶æªæ–½æ¢å¤æœåŠ¡  
    â†“
[30åˆ†é’Ÿ] å®šä½æ ¹æœ¬åŸå› 
    â†“  
[1å°æ—¶] å®æ–½æ ¹æœ¬è§£å†³æ–¹æ¡ˆ
    â†“
[24å°æ—¶] æ•…éšœå¤ç›˜å’Œé¢„é˜²æ”¹è¿›
```

**ğŸ¯ åº”æ€¥å†³ç­–çŸ©é˜µ**

```java
public class EmergencyHandler {
    
    public void handleEmergency(String faultType, String severity) {
        switch (severity) {
            case "P0": // æ ¸å¿ƒä¸šåŠ¡å®Œå…¨ä¸å¯ç”¨
                executeP0Response(faultType);
                break;
            case "P1": // æ ¸å¿ƒä¸šåŠ¡éƒ¨åˆ†å—å½±å“  
                executeP1Response(faultType);
                break;
            case "P2": // éæ ¸å¿ƒä¸šåŠ¡å—å½±å“
                executeP2Response(faultType);
                break;
        }
    }
    
    private void executeP0Response(String faultType) {
        // P0æ•…éšœï¼šç«‹å³åˆ‡æ¢åˆ°å¤‡ç”¨ç³»ç»Ÿ
        if ("memory_oom".equals(faultType)) {
            // å†…å­˜è€—å°½ï¼šç«‹å³é‡å¯Redisï¼Œå¯ç”¨ä»åº“
            restartRedisService();
            switchToSlave();
        } else if ("data_corruption".equals(faultType)) {
            // æ•°æ®æŸåï¼šåœæ­¢æœåŠ¡ï¼Œä»å¤‡ä»½æ¢å¤
            stopService();
            restoreFromBackup();
        }
        
        // é€šçŸ¥ç›¸å…³äººå‘˜
        notifyOnCall("P0æ•…éšœï¼š" + faultType);
    }
}
```

### 4.2 æœåŠ¡åˆ‡æ¢å’Œæ¢å¤


#### ä¸»ä»åˆ‡æ¢æ­¥éª¤


**ğŸ”„ ä¸»ä»åˆ‡æ¢çš„å®Œæ•´æµç¨‹**

ä¸»ä»åˆ‡æ¢å°±åƒå…¬å¸è€æ¿å‡ºå·®ï¼Œå‰¯æ€»ä¸´æ—¶ä»£ç†ã€‚è¦ç¡®ä¿æƒé™è½¬ç§»æ¸…æ¥šï¼Œä¸šåŠ¡ä¸ä¸­æ–­ã€‚

```bash
#!/bin/bash
# ä¸»ä»åˆ‡æ¢æ ‡å‡†æµç¨‹

# æ­¥éª¤1ï¼šæ£€æŸ¥ä»åº“çŠ¶æ€
echo "æ£€æŸ¥ä»åº“çŠ¶æ€..."
redis-cli -h slave-host info replication | grep master_link_status
# ç¡®ä¿ä»åº“ä¸ä¸»åº“è¿æ¥æ­£å¸¸

# æ­¥éª¤2ï¼šåœæ­¢ä¸»åº“å†™å…¥ï¼ˆå¯é€‰ï¼‰
echo "åœæ­¢åº”ç”¨å†™å…¥..."
# é€šçŸ¥åº”ç”¨å±‚åœæ­¢å†™æ“ä½œï¼Œæˆ–è€…è®¾ç½®Redisåªè¯»

# æ­¥éª¤3ï¼šç­‰å¾…ä»åº“åŒæ­¥å®Œæˆ
echo "ç­‰å¾…åŒæ­¥å®Œæˆ..."
while true; do
    lag=$(redis-cli -h slave-host info replication | grep master_repl_offset)
    if [ "$lag" == "0" ]; then
        break
    fi
    sleep 1
done

# æ­¥éª¤4ï¼šæå‡ä»åº“ä¸ºä¸»åº“
echo "æå‡ä»åº“ä¸ºä¸»åº“..."
redis-cli -h slave-host slaveof no one

# æ­¥éª¤5ï¼šæ›´æ–°åº”ç”¨é…ç½®
echo "æ›´æ–°åº”ç”¨é…ç½®..."
# ä¿®æ”¹åº”ç”¨çš„Redisè¿æ¥åœ°å€

# æ­¥éª¤6ï¼šéªŒè¯åˆ‡æ¢ç»“æœ
redis-cli -h slave-host info replication | grep role
# ç¡®è®¤role:master
```

#### é›†ç¾¤èŠ‚ç‚¹æ›¿æ¢æµç¨‹


**ğŸ”„ é›†ç¾¤èŠ‚ç‚¹æ›¿æ¢æ“ä½œ**

```java
public class ClusterNodeReplacer {
    
    // æ›¿æ¢æ•…éšœèŠ‚ç‚¹
    public void replaceFailedNode(String failedNodeId, String newNodeHost) {
        JedisCluster cluster = getClusterConnection();
        
        // 1. å‡†å¤‡æ–°èŠ‚ç‚¹
        prepareNewNode(newNodeHost);
        
        // 2. æ·»åŠ æ–°èŠ‚ç‚¹åˆ°é›†ç¾¤
        String addResult = cluster.clusterAddNode(newNodeHost + ":6379");
        String newNodeId = extractNodeId(addResult);
        
        // 3. è¿ç§»slots
        migrateSlots(failedNodeId, newNodeId);
        
        // 4. ç§»é™¤æ•…éšœèŠ‚ç‚¹
        cluster.clusterForget(failedNodeId);
        
        // 5. éªŒè¯é›†ç¾¤çŠ¶æ€
        verifyClusterHealth();
    }
    
    private void migrateSlots(String fromNodeId, String toNodeId) {
        // è·å–æ•…éšœèŠ‚ç‚¹è´Ÿè´£çš„slotèŒƒå›´
        List<Integer> slots = getNodeSlots(fromNodeId);
        
        for (Integer slot : slots) {
            // è®¾ç½®slotè¿ç§»
            cluster.clusterSetSlotMigrating(slot, toNodeId);
            cluster.clusterSetSlotImporting(slot, fromNodeId);
            
            // è¿ç§»slotä¸­çš„æ‰€æœ‰key
            migrateSlotKeys(slot, fromNodeId, toNodeId);
            
            // å®Œæˆslotè¿ç§»
            cluster.clusterSetSlotNode(slot, toNodeId);
        }
    }
}
```

### 4.3 æ•°æ®ä¿®å¤æŠ€æœ¯


**ğŸ”¨ æ•°æ®ä¿®å¤æ–¹æ³•**

```bash
# AOFæ–‡ä»¶ä¿®å¤
redis-check-aof --fix appendonly.aof

# RDBæ–‡ä»¶æ£€æŸ¥
redis-check-rdb dump.rdb

# ä»AOFé‡å»ºæ•°æ®
redis-server --appendonly yes --appendfilename corrupted.aof
```

---

## 5. ğŸ›¡ï¸ ç³»ç»Ÿä¼˜åŒ–å’Œé¢„é˜²æªæ–½


### 5.1 é¢„é˜²æ€§æªæ–½


#### å¥åº·æ£€æŸ¥æœºåˆ¶è®¾è®¡


**ğŸ’“ è‡ªåŠ¨å¥åº·æ£€æŸ¥ç³»ç»Ÿ**

```java
@Component
public class RedisHealthChecker {
    
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void performHealthCheck() {
        HealthStatus status = new HealthStatus();
        
        // åŸºç¡€è¿é€šæ€§æ£€æŸ¥
        try {
            String pong = jedis.ping();
            status.setConnectivity("PING".equals(pong));
        } catch (Exception e) {
            status.setConnectivity(false);
            alertConnectivityIssue(e);
        }
        
        // å†…å­˜ä½¿ç”¨æ£€æŸ¥
        checkMemoryHealth(status);
        
        // æ€§èƒ½æ£€æŸ¥
        checkPerformanceHealth(status);
        
        // ä¸»ä»åŒæ­¥æ£€æŸ¥
        checkReplicationHealth(status);
        
        // å‘é€å¥åº·æŠ¥å‘Š
        reportHealthStatus(status);
    }
    
    private void checkMemoryHealth(HealthStatus status) {
        Map<String, String> memInfo = jedis.info("memory");
        long usedMemory = Long.parseLong(memInfo.get("used_memory"));
        long maxMemory = Long.parseLong(memInfo.get("maxmemory"));
        
        double memoryUsage = (double) usedMemory / maxMemory;
        status.setMemoryUsage(memoryUsage);
        
        if (memoryUsage > 0.85) {
            alertHighMemoryUsage(memoryUsage);
        }
    }
}
```

#### å®¹é‡è§„åˆ’æ–¹æ³•


**ğŸ“Š å®¹é‡è§„åˆ’çš„ç§‘å­¦æ–¹æ³•**

```java
public class CapacityPlanner {
    
    // åŸºäºå†å²æ•°æ®é¢„æµ‹å®¹é‡éœ€æ±‚
    public CapacityPrediction predictCapacity(int futureDays) {
        // æ”¶é›†å†å²æ•°æ®
        List<DailyMetrics> history = collectHistoricalData(30); // 30å¤©å†å²
        
        // åˆ†æå¢é•¿è¶‹åŠ¿
        double dataGrowthRate = calculateGrowthRate(history);
        double qpsGrowthRate = calculateQpsGrowth(history);
        
        // é¢„æµ‹æœªæ¥éœ€æ±‚
        long currentDataSize = getCurrentDataSize();
        long currentQps = getCurrentQps();
        
        long predictedDataSize = (long)(currentDataSize * Math.pow(1 + dataGrowthRate, futureDays / 30.0));
        long predictedQps = (long)(currentQps * Math.pow(1 + qpsGrowthRate, futureDays / 30.0));
        
        // è®¡ç®—èµ„æºéœ€æ±‚
        return new CapacityPrediction()
            .setRequiredMemory(predictedDataSize * 2) // ç•™100%ç¼“å†²
            .setRequiredQps(predictedQps)
            .setRecommendedNodes(calculateNodes(predictedQps));
    }
    
    // å®¹é‡å‘Šè­¦é˜ˆå€¼
    public void setCapacityAlerts() {
        // å†…å­˜ä½¿ç”¨ç‡>70%é¢„è­¦
        // å†…å­˜ä½¿ç”¨ç‡>85%å‘Šè­¦  
        // QPS>è®¾è®¡å€¼80%é¢„è­¦
        // è¿æ¥æ•°>æœ€å¤§å€¼80%é¢„è­¦
    }
}
```

### 5.2 Redisé…ç½®ä¼˜åŒ–


**âš™ï¸ ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®**

```bash
# redis.conf ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–é…ç½®

# å†…å­˜é…ç½®
maxmemory 2gb
maxmemory-policy allkeys-lru  # å†…å­˜æ»¡æ—¶çš„åˆ é™¤ç­–ç•¥

# æŒä¹…åŒ–é…ç½®  
save 900 1     # 900ç§’å†…æœ‰1ä¸ªkeyå˜åŒ–åˆ™ä¿å­˜
save 300 10    # 300ç§’å†…æœ‰10ä¸ªkeyå˜åŒ–åˆ™ä¿å­˜  
save 60 10000  # 60ç§’å†…æœ‰10000ä¸ªkeyå˜åŒ–åˆ™ä¿å­˜

# AOFé…ç½®
appendonly yes
appendfsync everysec  # æ¯ç§’åŒæ­¥ä¸€æ¬¡
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# ç½‘ç»œé…ç½®
tcp-keepalive 300
timeout 0
tcp-backlog 511

# æ…¢æŸ¥è¯¢é…ç½®
slowlog-log-slower-than 10000  # è®°å½•è¶…è¿‡10msçš„æŸ¥è¯¢
slowlog-max-len 128

# å®¢æˆ·ç«¯é…ç½®
maxclients 10000
```

### 5.3 ç›‘æ§æŠ¥è­¦è®¾ç½®


**ğŸ“¢ å¤šå±‚æ¬¡æŠ¥è­¦ä½“ç³»**

```java
@Component  
public class AlertManager {
    
    // è®¾ç½®åˆ†çº§æŠ¥è­¦
    public void setupAlerts() {
        // P0å‘Šè­¦ï¼šæœåŠ¡ä¸å¯ç”¨
        createAlert("redis_down", "RedisæœåŠ¡åœæ­¢", AlertLevel.P0);
        createAlert("memory_oom", "å†…å­˜è€—å°½", AlertLevel.P0);
        
        // P1å‘Šè­¦ï¼šæ€§èƒ½ä¸¥é‡ä¸‹é™
        createAlert("high_latency", "å“åº”å»¶è¿Ÿ>50ms", AlertLevel.P1);  
        createAlert("low_hit_rate", "ç¼“å­˜å‘½ä¸­ç‡<70%", AlertLevel.P1);
        
        // P2å‘Šè­¦ï¼šæ½œåœ¨é£é™©
        createAlert("memory_high", "å†…å­˜ä½¿ç”¨>80%", AlertLevel.P2);
        createAlert("connection_high", "è¿æ¥æ•°>80%", AlertLevel.P2);
    }
    
    // æ™ºèƒ½æŠ¥è­¦ç­–ç•¥
    public void smartAlert(String metric, double value, double threshold) {
        // é¿å…æŠ¥è­¦é£æš´ï¼š5åˆ†é’Ÿå†…ç›¸åŒå‘Šè­¦åªå‘ä¸€æ¬¡
        String alertKey = "alert:" + metric + ":" + (System.currentTimeMillis() / 300000);
        if (jedis.exists(alertKey)) {
            return; // å·²ç»å‘è¿‡å‘Šè­¦äº†
        }
        
        // å‘é€å‘Šè­¦
        sendAlert(metric, value, threshold);
        
        // æ ‡è®°å·²å‘Šè­¦
        jedis.setex(alertKey, 300, "1");
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ’æŸ¥æ€è·¯


```
ğŸ”¸ æ•…éšœæ’æŸ¥æµç¨‹ï¼šæ”¶é›†ä¿¡æ¯â†’å®šä½é—®é¢˜â†’åˆ†æåŸå› â†’åˆ¶å®šæ–¹æ¡ˆâ†’æ‰§è¡Œæ¢å¤â†’é¢„é˜²æ”¹è¿›
ğŸ”¸ é—®é¢˜åˆ†ç±»èƒ½åŠ›ï¼šå†…å­˜ã€è¿æ¥ã€æ€§èƒ½ã€æ•°æ®ã€åŒæ­¥äº”å¤§ç±»æ•…éšœ
ğŸ”¸ åº”æ€¥å¤„ç†åŸåˆ™ï¼šå…ˆæ¢å¤æœåŠ¡ï¼Œå†æŸ¥æ‰¾åŸå› ï¼Œæœ€åé¢„é˜²æ”¹è¿›
ğŸ”¸ ç›‘æ§ä½“ç³»å»ºè®¾ï¼šæŒ‡æ ‡ç›‘æ§ã€æ—¥å¿—åˆ†æã€å¥åº·æ£€æŸ¥ã€æŠ¥è­¦é€šçŸ¥
ğŸ”¸ é¢„é˜²æ€§æ€ç»´ï¼šå®¹é‡è§„åˆ’ã€é…ç½®ä¼˜åŒ–ã€æ¼”ç»ƒæµ‹è¯•ã€è‡ªåŠ¨åŒ–è¿ç»´
```

### 6.2 å…³é”®æŠ€èƒ½è¦ç‚¹


**ğŸ”¹ æ•…éšœå®šä½çš„æ ¸å¿ƒæŠ€èƒ½**
```
çœ‹æ—¥å¿—ï¼šä»é”™è¯¯ä¿¡æ¯ä¸­æ‰¾çº¿ç´¢
æŸ¥æŒ‡æ ‡ï¼šä»ç›‘æ§æ•°æ®ä¸­å‘ç°å¼‚å¸¸  
ç”¨å‘½ä»¤ï¼šé€šè¿‡è¯Šæ–­å‘½ä»¤æ·±å…¥åˆ†æ
åšå®éªŒï¼šé€šè¿‡å¤ç°é—®é¢˜éªŒè¯çŒœæµ‹
```

**ğŸ”¹ åº”æ€¥å¤„ç†çš„åŸºæœ¬åŸåˆ™**
```
ä¼˜å…ˆçº§ï¼šæ•°æ®å®‰å…¨ > æœåŠ¡æ¢å¤ > æ€§èƒ½ä¼˜åŒ–
æ—¶æ•ˆæ€§ï¼šå¿«é€Ÿå“åº” > å®Œç¾æ–¹æ¡ˆ
å½±å“é¢ï¼šæœ€å°åŒ–å½±å“èŒƒå›´å’Œæ—¶é—´
å¯å›æ»šï¼šä»»ä½•æ“ä½œéƒ½è¦èƒ½å¤Ÿæ’¤é”€
```

**ğŸ”¹ é¢„é˜²æ€§è¿ç»´çš„æ ¸å¿ƒç†å¿µ**
```
ç›‘æ§å…ˆè¡Œï¼šé—®é¢˜å‘ç”Ÿå‰å°±è¦å‘ç°å¼‚å¸¸
è‡ªåŠ¨åŒ–ï¼šå‡å°‘äººä¸ºæ“ä½œé”™è¯¯
æ ‡å‡†åŒ–ï¼šåˆ¶å®šæ ‡å‡†æ“ä½œæµç¨‹
æ¼”ç»ƒåˆ¶ï¼šå®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
```

### 6.3 å®æˆ˜ç»éªŒæ€»ç»“


**âœ… æœ€ä½³å®è·µ**
- **å»ºç«‹ç›‘æ§ä½“ç³»**ï¼šè¦†ç›–æ‰€æœ‰å…³é”®æŒ‡æ ‡ï¼Œè®¾ç½®åˆç†é˜ˆå€¼
- **åˆ¶å®šåº”æ€¥é¢„æ¡ˆ**ï¼šé’ˆå¯¹å¸¸è§æ•…éšœåˆ¶å®šæ ‡å‡†å¤„ç†æµç¨‹  
- **å®šæœŸå®¹é‡è¯„ä¼°**ï¼šæ ¹æ®ä¸šåŠ¡å¢é•¿è°ƒæ•´èµ„æºé…ç½®
- **æ•…éšœæ¼”ç»ƒæµ‹è¯•**ï¼šå®šæœŸæ¨¡æ‹Ÿæ•…éšœï¼ŒéªŒè¯åº”æ€¥æ–¹æ¡ˆ
- **æ–‡æ¡£åŒ–ç®¡ç†**ï¼šè®°å½•æ‰€æœ‰é…ç½®ã€æµç¨‹å’Œç»éªŒæ•™è®­

**âŒ å¸¸è§è¯¯åŒº**
- **å¤´ç—›åŒ»å¤´**ï¼šåªè§£å†³è¡¨é¢é—®é¢˜ï¼Œä¸åˆ†ææ ¹æœ¬åŸå› 
- **è¿‡åº¦ä¼˜åŒ–**ï¼šä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ–ï¼Œå¿½ç•¥ä¸šåŠ¡å®é™…éœ€æ±‚
- **ç¼ºä¹ç›‘æ§**ï¼šç­‰å‡ºé—®é¢˜æ‰å‘ç°ï¼Œå¤±å»æœ€ä½³å¤„ç†æ—¶æœº
- **å•ç‚¹ä¾èµ–**ï¼šæ²¡æœ‰å¤‡ç”¨æ–¹æ¡ˆï¼Œæ•…éšœæ—¶æŸæ‰‹æ— ç­–
- **ç»éªŒä¸»ä¹‰**ï¼šå‡­æ„Ÿè§‰åˆ¤æ–­ï¼Œä¸åŸºäºæ•°æ®åˆ†æ

**ğŸ¯ è¿ç»´æˆç†Ÿåº¦è¯„ä¼°**
```
Level 1ï¼šè¢«åŠ¨å“åº”
- é—®é¢˜å‘ç”Ÿåæ‰å¤„ç†
- ä¸»è¦é äººå·¥æ“ä½œ

Level 2ï¼šä¸»åŠ¨ç›‘æ§  
- å»ºç«‹åŸºç¡€ç›‘æ§
- æœ‰ç®€å•çš„æŠ¥è­¦æœºåˆ¶

Level 3ï¼šé¢„é˜²æ€§è¿ç»´
- å®¹é‡è§„åˆ’å’Œé¢„æµ‹
- è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·

Level 4ï¼šæ™ºèƒ½åŒ–è¿ç»´
- AIè¾…åŠ©æ•…éšœè¯Šæ–­
- è‡ªåŠ¨æ•…éšœæ¢å¤
```

### 6.4 æŒç»­æ”¹è¿›å»ºè®®


**ğŸ“ˆ æ•…éšœå¤„ç†èƒ½åŠ›æå‡è·¯å¾„**
- **ç†è®ºå­¦ä¹ **ï¼šæ·±å…¥ç†è§£RedisåŸç†å’Œæœ€ä½³å®è·µ
- **å®æˆ˜ç»ƒä¹ **ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­æ¨¡æ‹Ÿå„ç§æ•…éšœåœºæ™¯
- **ç»éªŒç§¯ç´¯**ï¼šå»ºç«‹æ•…éšœæ¡ˆä¾‹åº“ï¼Œæ€»ç»“å¤„ç†ç»éªŒ
- **å·¥å…·ç†Ÿç»ƒ**ï¼šæŒæ¡å„ç§ç›‘æ§å’Œè¯Šæ–­å·¥å…·ä½¿ç”¨
- **å›¢é˜Ÿåä½œ**ï¼šå»ºç«‹On-Callåˆ¶åº¦ï¼Œæå‡å›¢é˜Ÿåº”æ€¥å“åº”èƒ½åŠ›

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ•…éšœæ’æŸ¥æœ‰æ–¹æ³•ï¼ŒæŒ‰æµç¨‹ä¸æ…Œä¹±
- ç›‘æ§é¢„è­¦å¾ˆé‡è¦ï¼Œæå‰å‘ç°æ—©å¤„ç†
- åº”æ€¥å¤„ç†åˆ†ä¼˜å…ˆï¼Œæ•°æ®å®‰å…¨æ”¾ç¬¬ä¸€
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œé…ç½®ä¼˜åŒ–æ˜¯åŸºç¡€
- æŒç»­æ”¹è¿›æèƒ½åŠ›ï¼Œæ–‡æ¡£è®°å½•åŠ©ä¼ æ‰¿