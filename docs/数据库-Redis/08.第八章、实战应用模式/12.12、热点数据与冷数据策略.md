---
title: 12ã€çƒ­ç‚¹æ•°æ®ä¸å†·æ•°æ®ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [çƒ­ç‚¹æ•°æ®ä¸å†·æ•°æ®æ¦‚å¿µ](#1-çƒ­ç‚¹æ•°æ®ä¸å†·æ•°æ®æ¦‚å¿µ)
2. [çƒ­ç‚¹é”®è¯†åˆ«æŠ€æœ¯](#2-çƒ­ç‚¹é”®è¯†åˆ«æŠ€æœ¯)
3. [åˆ†ç‰‡é™æµç­–ç•¥](#3-åˆ†ç‰‡é™æµç­–ç•¥)
4. [æ‡’åŠ è½½æœºåˆ¶](#4-æ‡’åŠ è½½æœºåˆ¶)
5. [æœ¬åœ°ç¼“å­˜ä¼˜åŒ–](#5-æœ¬åœ°ç¼“å­˜ä¼˜åŒ–)
6. [ç»¼åˆåº”ç”¨ç­–ç•¥](#6-ç»¼åˆåº”ç”¨ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”¥ çƒ­ç‚¹æ•°æ®ä¸å†·æ•°æ®æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯çƒ­ç‚¹æ•°æ®å’Œå†·æ•°æ®


**ğŸ¯ é€šä¿—ç†è§£**

æƒ³è±¡ä¸€ä¸ªå›¾ä¹¦é¦†ï¼š
- **çƒ­ç‚¹æ•°æ®**ï¼šå°±åƒçƒ­é—¨å°è¯´ï¼Œå¾ˆå¤šäººéƒ½è¦å€Ÿï¼Œå›¾ä¹¦ç®¡ç†å‘˜ä¼šæŠŠå®ƒä»¬æ”¾åœ¨æœ€å®¹æ˜“æ‹¿åˆ°çš„ä½ç½®
- **å†·æ•°æ®**ï¼šå°±åƒå¤ç±æ–‡çŒ®ï¼Œå¾ˆå°‘æœ‰äººå€Ÿé˜…ï¼Œå¯ä»¥æ”¾åœ¨ä»“åº“æ·±å¤„

```
çƒ­ç‚¹æ•°æ®ç‰¹å¾ï¼š
ğŸ“ˆ è®¿é—®é¢‘ç‡é«˜    - çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚
âš¡ æ—¶æ•ˆæ€§å¼º     - å®æ—¶æ€§è¦æ±‚é«˜
ğŸ¯ å½±å“é¢å¤§     - å½±å“å¤§é‡ç”¨æˆ·ä½“éªŒ
ğŸ’° å•†ä¸šä»·å€¼é«˜   - ç›´æ¥å…³ç³»ä¸šåŠ¡æ”¶ç›Š

å†·æ•°æ®ç‰¹å¾ï¼š
ğŸ“‰ è®¿é—®é¢‘ç‡ä½    - é•¿æœŸå¾ˆå°‘è¢«è®¿é—®
â° æ—¶æ•ˆæ€§å¼±     - å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜
ğŸ‘¤ å½±å“é¢å°     - ä¸ªåˆ«ç”¨æˆ·å…³å¿ƒ
ğŸ’¸ ä»·å€¼ç›¸å¯¹ä½   - å¯¹ä¸šåŠ¡å½±å“è¾ƒå°
```

### 1.2 çƒ­ç‚¹æ•°æ®é—®é¢˜çš„å±å®³


**ğŸ’£ çƒ­ç‚¹Keyé—®é¢˜çš„å½±å“**

```
ç³»ç»Ÿå½±å“ç¤ºæ„å›¾ï¼š
                         å¤§é‡è¯·æ±‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Redisé›†ç¾¤                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Node1 â”‚  â”‚Node2 â”‚  â”‚Node3 â”‚  â”‚Node4 â”‚ â”‚
â”‚  â”‚      â”‚  â”‚ ğŸ”¥ğŸ’¥ â”‚  â”‚      â”‚  â”‚      â”‚ â”‚  â† æŸä¸ªèŠ‚ç‚¹è¿‡çƒ­
â”‚  â”‚ 20%  â”‚  â”‚ 80%  â”‚  â”‚ 10%  â”‚  â”‚ 15%  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜è¡¨ç°ï¼š
â€¢ å•èŠ‚ç‚¹CPUä½¿ç”¨ç‡é£™å‡è‡³100%
â€¢ ç½‘ç»œå¸¦å®½æ‰“æ»¡
â€¢ å“åº”å»¶è¿Ÿæ€¥å‰§å¢åŠ   
â€¢ å¯èƒ½å¯¼è‡´èŠ‚ç‚¹å®•æœº
```

**ğŸ“Š çœŸå®åœºæ™¯ä¸¾ä¾‹**

| åœºæ™¯ | **çƒ­ç‚¹Key** | **è®¿é—®ç‰¹ç‚¹** | **å±å®³** |
|------|------------|-------------|---------|
| **ç”µå•†ç§’æ€** | `product:123:stock` | `ç¬é—´10ä¸‡+QPS` | `åº“å­˜æœåŠ¡å™¨å®•æœº` |
| **çƒ­é—¨ç›´æ’­** | `live:room:888:info` | `æŒç»­é«˜å¹¶å‘è®¿é—®` | `ç›´æ’­å¡é¡¿æ‰çº¿` |
| **æ˜æ˜Ÿçƒ­æœ** | `trending:star:xxx` | `çªå‘æ€§æµé‡æš´å¢` | `æœç´¢åŠŸèƒ½å¼‚å¸¸` |
| **æ¸¸æˆæ’è¡Œæ¦œ** | `rank:global:top100` | `é¢‘ç¹è¯»å–æ›´æ–°` | `æ’è¡Œæ¦œæ˜¾ç¤ºå»¶è¿Ÿ` |

---

## 2. ğŸ” çƒ­ç‚¹é”®è¯†åˆ«æŠ€æœ¯


### 2.1 å®æ—¶ç›‘æ§è¯†åˆ«


**ğŸ“ˆ åŸºäºè®¿é—®é¢‘ç‡çš„è¯†åˆ«**

```java
@Component
public class HotKeyDetector {
    
    // æ»‘åŠ¨çª—å£ç»Ÿè®¡è®¿é—®é¢‘ç‡
    public boolean isHotKey(String key) {
        String statsKey = "stats:access:" + key;
        String currentMinute = String.valueOf(System.currentTimeMillis() / 60000);
        String countKey = statsKey + ":" + currentMinute;
        
        // å½“å‰åˆ†é’Ÿè®¿é—®æ¬¡æ•°
        Long currentCount = jedis.incr(countKey);
        if (currentCount == 1) {
            jedis.expire(countKey, 60);
        }
        
        // è®¡ç®—æœ€è¿‘5åˆ†é’Ÿå¹³å‡QPS
        long totalAccess = 0;
        for (int i = 0; i < 5; i++) {
            String timeKey = statsKey + ":" + (Long.parseLong(currentMinute) - i);
            String count = jedis.get(timeKey);
            totalAccess += (count != null ? Long.parseLong(count) : 0);
        }
        
        double avgQps = totalAccess / 300.0; // 5åˆ†é’Ÿ=300ç§’
        return avgQps > 100; // QPSè¶…è¿‡100è®¤ä¸ºæ˜¯çƒ­ç‚¹
    }
}
```

**ğŸ•µï¸ å¤šç»´åº¦è¯†åˆ«ç­–ç•¥**

```java
public class AdvancedHotKeyDetector {
    
    // ç»¼åˆè¯„åˆ†è¯†åˆ«çƒ­ç‚¹Key
    public HotKeyInfo detectHotKey(String key, KeyAccessInfo accessInfo) {
        HotKeyInfo info = new HotKeyInfo(key);
        
        // 1. QPSè¯„åˆ† (0-40åˆ†)
        double qpsScore = Math.min(accessInfo.getQps() / 10, 40);
        
        // 2. å¹¶å‘åº¦è¯„åˆ† (0-30åˆ†)  
        double concurrentScore = Math.min(accessInfo.getConcurrentUsers() / 50, 30);
        
        // 3. æ•°æ®å¤§å°è¯„åˆ† (0-20åˆ†)
        double sizeScore = Math.min(accessInfo.getDataSize() / 1024, 20);
        
        // 4. ä¸šåŠ¡é‡è¦æ€§è¯„åˆ† (0-10åˆ†)
        double businessScore = accessInfo.getBusinessLevel() * 2;
        
        double totalScore = qpsScore + concurrentScore + sizeScore + businessScore;
        
        info.setHotScore(totalScore);
        info.setHotLevel(getHotLevel(totalScore));
        
        return info;
    }
    
    private HotLevel getHotLevel(double score) {
        if (score >= 80) return HotLevel.EXTREMELY_HOT;  // æçƒ­
        if (score >= 60) return HotLevel.VERY_HOT;       // å¾ˆçƒ­
        if (score >= 40) return HotLevel.HOT;            // çƒ­
        if (score >= 20) return HotLevel.WARM;           // æ¸©çƒ­
        return HotLevel.COLD;                            // å†·
    }
}
```

### 1.2 é¢„æµ‹æ€§è¯†åˆ«


**ğŸ“Š åŸºäºå†å²æ•°æ®é¢„æµ‹**

```java
public class HotKeyPredictor {
    
    // åŸºäºå†å²è®¿é—®æ¨¡å¼é¢„æµ‹çƒ­ç‚¹
    public List<String> predictTomorrowHotKeys() {
        // åˆ†ææœ€è¿‘7å¤©åŒä¸€æ—¶é—´æ®µçš„è®¿é—®æ¨¡å¼
        String today = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyyMMdd"));
        String currentHour = String.valueOf(LocalDateTime.now().getHour());
        
        Map<String, Long> keyAccessCount = new HashMap<>();
        
        // ç»Ÿè®¡å†å²7å¤©åŒä¸€å°æ—¶çš„è®¿é—®æ•°æ®
        for (int dayOffset = 1; dayOffset <= 7; dayOffset++) {
            String historyDate = LocalDate.now().minusDays(dayOffset)
                                  .format(DateTimeFormatter.ofPattern("yyyyMMdd"));
            String pattern = "stats:" + historyDate + ":" + currentHour + ":*";
            
            Set<String> keys = jedis.keys(pattern);
            for (String key : keys) {
                String accessCount = jedis.get(key);
                if (accessCount != null) {
                    String originalKey = extractOriginalKey(key);
                    keyAccessCount.merge(originalKey, Long.parseLong(accessCount), Long::sum);
                }
            }
        }
        
        // è¿”å›è®¿é—®é‡å‰20çš„Keyä½œä¸ºé¢„æµ‹çƒ­ç‚¹
        return keyAccessCount.entrySet().stream()
                .sorted(Map.Entry.<String, Long>comparingByValue().reversed())
                .limit(20)
                .map(Map.Entry::getKey)
                .collect(Collectors.toList());
    }
}
```

---

## 3. ğŸ—‚ï¸ åˆ†ç‰‡é™æµç­–ç•¥


### 3.1 çƒ­ç‚¹Keyåˆ†ç‰‡åŸç†


**ğŸ§© ä»€ä¹ˆæ˜¯çƒ­ç‚¹Keyåˆ†ç‰‡ï¼Ÿ**

å½“ä¸€ä¸ªKeyè®¿é—®é‡å¤ªå¤§æ—¶ï¼Œæˆ‘ä»¬æŠŠå®ƒ"å¤åˆ¶"æˆå¤šä¸ªKeyï¼Œåˆ†æ•£è®¿é—®å‹åŠ›ã€‚

```
åŸå§‹æƒ…å†µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  product:123    â”‚ â† 10ä¸‡QPSï¼Œå‹åŠ›å·¨å¤§
â”‚  (å•†å“ä¿¡æ¯)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†ç‰‡åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ product:123:0   â”‚ â”‚ product:123:1   â”‚ â”‚ product:123:2   â”‚
â”‚   (å‰¯æœ¬1)       â”‚ â”‚   (å‰¯æœ¬2)       â”‚ â”‚   (å‰¯æœ¬3)       â”‚
â”‚  3.3ä¸‡QPS       â”‚ â”‚  3.3ä¸‡QPS       â”‚ â”‚  3.3ä¸‡QPS       â”‚  
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åˆ†ç‰‡ç­–ç•¥å®ç°


**âš¡ è¯»åˆ†ç‰‡å®ç°**

```java
@Service
public class HotKeyShardingService {
    
    private static final int SHARD_COUNT = 10; // åˆ†ç‰‡æ•°é‡
    
    // å†™å…¥çƒ­ç‚¹æ•°æ®ï¼ˆå†™å…¥æ‰€æœ‰åˆ†ç‰‡ï¼‰
    public void setHotKey(String key, String value, int expireSeconds) {
        if (isHotKey(key)) {
            // çƒ­ç‚¹Keyå†™å…¥æ‰€æœ‰åˆ†ç‰‡
            for (int i = 0; i < SHARD_COUNT; i++) {
                String shardKey = key + ":shard:" + i;
                jedis.setex(shardKey, expireSeconds, value);
            }
        } else {
            // æ™®é€šKeyæ­£å¸¸å†™å…¥
            jedis.setex(key, expireSeconds, value);
        }
    }
    
    // è¯»å–çƒ­ç‚¹æ•°æ®ï¼ˆéšæœºé€‰æ‹©åˆ†ç‰‡ï¼‰
    public String getHotKey(String key) {
        if (isHotKey(key)) {
            // éšæœºé€‰æ‹©ä¸€ä¸ªåˆ†ç‰‡è¯»å–
            int shardIndex = ThreadLocalRandom.current().nextInt(SHARD_COUNT);
            String shardKey = key + ":shard:" + shardIndex;
            return jedis.get(shardKey);
        } else {
            return jedis.get(key);
        }
    }
    
    // åˆ¤æ–­æ˜¯å¦ä¸ºçƒ­ç‚¹Key
    private boolean isHotKey(String key) {
        // å¯ä»¥åŸºäºé…ç½®æ–‡ä»¶ã€å®æ—¶ç›‘æ§æ•°æ®ç­‰åˆ¤æ–­
        return hotKeyConfig.contains(key) || 
               currentHotKeys.contains(key);
    }
}
```

### 3.3 é™æµåˆ†ç‰‡ç­–ç•¥


**ğŸš¦ åŸºäºä»¤ç‰Œæ¡¶çš„åˆ†ç‰‡é™æµ**

```java
public class ShardedRateLimiter {
    
    // ä¸ºçƒ­ç‚¹Keyåˆ›å»ºå¤šä¸ªé™æµå™¨
    public boolean acquirePermit(String key, String userId) {
        if (isHotKey(key)) {
            // çƒ­ç‚¹Keyä½¿ç”¨åˆ†ç‰‡é™æµ
            return acquireFromShards(key, userId);
        } else {
            // æ™®é€šKeyå•ä¸€é™æµ
            return acquireSingle(key, userId);
        }
    }
    
    private boolean acquireFromShards(String key, String userId) {
        // ç”¨æˆ·å“ˆå¸Œåˆ°å›ºå®šåˆ†ç‰‡ï¼Œä¿è¯åŒä¸€ç”¨æˆ·è®¿é—®åŒä¸€é™æµå™¨
        int shardIndex = Math.abs(userId.hashCode()) % SHARD_COUNT;
        String limitKey = "rate_limit:" + key + ":shard:" + shardIndex;
        
        // æ¯ä¸ªåˆ†ç‰‡æ‰¿æ‹…æ€»é™æµçš„1/N
        int shardLimit = getTotalLimit(key) / SHARD_COUNT;
        return checkRateLimit(limitKey, shardLimit);
    }
    
    private boolean checkRateLimit(String limitKey, int limit) {
        String script = 
            "local current = redis.call('GET', KEYS[1]) " +
            "if current == false then " +
            "  redis.call('SET', KEYS[1], 1) " +
            "  redis.call('EXPIRE', KEYS[1], ARGV[2]) " +
            "  return 1 " +
            "elseif tonumber(current) < tonumber(ARGV[1]) then " +
            "  redis.call('INCR', KEYS[1]) " +
            "  return 1 " +
            "else " +
            "  return 0 " +
            "end";
            
        Object result = jedis.eval(script, Arrays.asList(limitKey), 
                                  Arrays.asList(String.valueOf(limit), "60"));
        return "1".equals(result.toString());
    }
}
```

---

## 4. â° æ‡’åŠ è½½æœºåˆ¶


### 4.1 æ‡’åŠ è½½åŸºæœ¬æ¦‚å¿µ


**ğŸ¤” ä»€ä¹ˆæ˜¯æ‡’åŠ è½½ï¼Ÿ**

æ‡’åŠ è½½å°±æ˜¯"ç”¨æ—¶å†å–"çš„æ€æƒ³ã€‚ä¸æå‰æŠŠæ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°ç¼“å­˜ï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰åŠ è½½ï¼Œåç»­è®¿é—®ç›´æ¥ä»ç¼“å­˜è·å–ã€‚

```
ä¼ ç»Ÿé¢„åŠ è½½ï¼š
å¯åŠ¨æ—¶ -> åŠ è½½æ‰€æœ‰å•†å“ä¿¡æ¯åˆ°ç¼“å­˜ -> å ç”¨å¤§é‡å†…å­˜

æ‡’åŠ è½½ï¼š
ç¬¬ä¸€æ¬¡è®¿é—®å•†å“A -> ä»æ•°æ®åº“æŸ¥è¯¢ -> æ”¾å…¥ç¼“å­˜
ç¬¬äºŒæ¬¡è®¿é—®å•†å“A -> ç›´æ¥ä»ç¼“å­˜è·å– âœ“
è®¿é—®å•†å“B -> ä»æ•°æ®åº“æŸ¥è¯¢ -> æ”¾å…¥ç¼“å­˜
```

### 4.2 æ‡’åŠ è½½å®ç°ç­–ç•¥


**ğŸ”„ Cache-Asideæ¨¡å¼å®ç°**

```java
@Service
public class LazyLoadService {
    
    // é€šç”¨æ‡’åŠ è½½æ¨¡æ¿
    public <T> T lazyLoad(String key, int expireSeconds, 
                         Supplier<T> dataLoader, Class<T> clazz) {
        // 1. å…ˆæŸ¥ç¼“å­˜
        String cachedData = jedis.get(key);
        if (cachedData != null && !"null".equals(cachedData)) {
            return JSON.parseObject(cachedData, clazz);
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®æº
        T data = dataLoader.get();
        
        // 3. å°†ç»“æœæ”¾å…¥ç¼“å­˜
        if (data != null) {
            jedis.setex(key, expireSeconds, JSON.toJSONString(data));
        } else {
            // é˜²æ­¢ç¼“å­˜ç©¿é€ï¼šç¼“å­˜ç©ºå€¼
            jedis.setex(key, 300, "null");
        }
        
        return data;
    }
    
    // å•†å“ä¿¡æ¯æ‡’åŠ è½½
    public Product getProductLazy(Long productId) {
        String key = "product:lazy:" + productId;
        return lazyLoad(key, 3600, 
                       () -> productService.getById(productId), 
                       Product.class);
    }
}
```

### 4.3 åˆ†çº§æ‡’åŠ è½½ç­–ç•¥


**ğŸ“Š å¤šå±‚æ¬¡æ‡’åŠ è½½**

```java
public class TieredLazyLoad {
    
    // åˆ†çº§ç¼“å­˜ï¼šå†…å­˜ -> Redis -> æ•°æ®åº“
    public Product getProductWithTiers(Long productId) {
        String cacheKey = "product:" + productId;
        
        // L1: æœ¬åœ°å†…å­˜ç¼“å­˜ (æœ€å¿«)
        Product product = localCache.get(cacheKey);
        if (product != null) {
            return product;
        }
        
        // L2: Redisç¼“å­˜ (è¾ƒå¿«)
        String productJson = jedis.get(cacheKey);
        if (productJson != null && !"null".equals(productJson)) {
            product = JSON.parseObject(productJson, Product.class);
            // æ”¾å…¥æœ¬åœ°ç¼“å­˜
            localCache.put(cacheKey, product, 300); // 5åˆ†é’Ÿ
            return product;
        }
        
        // L3: æ•°æ®åº“æŸ¥è¯¢ (æ…¢)
        product = productService.getById(productId);
        if (product != null) {
            // åŒæ—¶æ›´æ–°ä¸¤çº§ç¼“å­˜
            jedis.setex(cacheKey, 3600, JSON.toJSONString(product));
            localCache.put(cacheKey, product, 300);
        } else {
            jedis.setex(cacheKey, 300, "null");
        }
        
        return product;
    }
}
```

### 4.4 æ™ºèƒ½é¢„åŠ è½½ç­–ç•¥


**ğŸ§  åŸºäºè®¿é—®æ¨¡å¼çš„é¢„æµ‹åŠ è½½**

```java
public class SmartPreloader {
    
    // åŸºäºå…³è”æ€§é¢„åŠ è½½
    public void smartPreload(String accessedKey) {
        // åˆ†æè®¿é—®æ¨¡å¼ï¼Œé¢„æµ‹å¯èƒ½è®¿é—®çš„ç›¸å…³æ•°æ®
        if (accessedKey.startsWith("product:")) {
            Long productId = Long.parseLong(accessedKey.substring(8));
            
            // é¢„åŠ è½½ç›¸å…³å•†å“ä¿¡æ¯
            preloadRelatedData(productId);
        }
    }
    
    private void preloadRelatedData(Long productId) {
        // å¼‚æ­¥é¢„åŠ è½½ç›¸å…³æ•°æ®ï¼Œé¿å…é˜»å¡ä¸»æµç¨‹
        CompletableFuture.runAsync(() -> {
            // é¢„åŠ è½½åŒç±»å•†å“
            List<Long> relatedIds = productService.getRelatedProductIds(productId);
            for (Long relatedId : relatedIds.subList(0, Math.min(5, relatedIds.size()))) {
                String key = "product:" + relatedId;
                if (!jedis.exists(key)) {
                    Product relatedProduct = productService.getById(relatedId);
                    if (relatedProduct != null) {
                        jedis.setex(key, 1800, JSON.toJSONString(relatedProduct));
                    }
                }
            }
        });
    }
}
```

---

## 5. ğŸ’¾ æœ¬åœ°ç¼“å­˜ä¼˜åŒ–


### 5.1 æœ¬åœ°ç¼“å­˜çš„ä»·å€¼


**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°ç¼“å­˜ï¼Ÿ**

```
è®¿é—®å»¶è¿Ÿå¯¹æ¯”ï¼š
æœ¬åœ°å†…å­˜è®¿é—®:  1-5 å¾®ç§’
Redisç½‘ç»œè®¿é—®: 1-5 æ¯«ç§’     â† æ¯”æœ¬åœ°æ…¢1000å€
æ•°æ®åº“è®¿é—®:    10-100 æ¯«ç§’  â† æ¯”Redisæ…¢10-100å€

ç»“è®ºï¼šæœ¬åœ°ç¼“å­˜è™½ç„¶å®¹é‡å°ï¼Œä½†é€Ÿåº¦æå¿«ï¼Œé€‚åˆçƒ­ç‚¹æ•°æ®
```

### 5.2 å¤šçº§ç¼“å­˜æ¶æ„


**ğŸ—ï¸ L1+L2+L3ç¼“å­˜ä½“ç³»**

```java
@Configuration
public class MultiLevelCacheConfig {
    
    // L1: æœ¬åœ°ç¼“å­˜é…ç½® (Caffeine)
    @Bean
    public Cache<String, Object> localCache() {
        return Caffeine.newBuilder()
                .maximumSize(10_000)           // æœ€å¤š1ä¸‡ä¸ªå¯¹è±¡
                .expireAfterWrite(5, TimeUnit.MINUTES)  // 5åˆ†é’Ÿè¿‡æœŸ
                .recordStats()                  // è®°å½•ç»Ÿè®¡ä¿¡æ¯
                .build();
    }
}

@Service
public class MultiLevelCacheService {
    
    @Autowired
    private Cache<String, Object> localCache;
    
    public Product getProduct(Long productId) {
        String key = "product:" + productId;
        
        // L1: æœ¬åœ°ç¼“å­˜æŸ¥è¯¢
        Product product = (Product) localCache.getIfPresent(key);
        if (product != null) {
            recordCacheHit("L1", key);
            return product;
        }
        
        // L2: Redisç¼“å­˜æŸ¥è¯¢
        String productJson = jedis.get(key);
        if (productJson != null && !"null".equals(productJson)) {
            product = JSON.parseObject(productJson, Product.class);
            localCache.put(key, product); // å†™å…¥L1ç¼“å­˜
            recordCacheHit("L2", key);
            return product;
        }
        
        // L3: æ•°æ®åº“æŸ¥è¯¢
        product = productService.getById(productId);
        if (product != null) {
            // å›å¡«ç¼“å­˜
            jedis.setex(key, 3600, JSON.toJSONString(product));
            localCache.put(key, product);
            recordCacheHit("DB", key);
        }
        
        return product;
    }
}
```

### 5.3 æœ¬åœ°ç¼“å­˜æ›´æ–°ç­–ç•¥


**ğŸ”„ ç¼“å­˜ä¸€è‡´æ€§ä¿éšœ**

```java
public class LocalCacheUpdater {
    
    // æ–¹æ¡ˆ1ï¼šåŸºäºRediså‘å¸ƒè®¢é˜…çš„ç¼“å­˜å¤±æ•ˆ
    public void setupCacheInvalidation() {
        jedis.subscribe(new JedisPubSub() {
            @Override
            public void onMessage(String channel, String message) {
                if ("cache:invalidate".equals(channel)) {
                    // æ”¶åˆ°å¤±æ•ˆé€šçŸ¥ï¼Œæ¸…é™¤æœ¬åœ°ç¼“å­˜
                    localCache.invalidate(message);
                    log.info("æœ¬åœ°ç¼“å­˜å·²å¤±æ•ˆ: {}", message);
                }
            }
        }, "cache:invalidate");
    }
    
    // æ•°æ®æ›´æ–°æ—¶å‘å¸ƒå¤±æ•ˆé€šçŸ¥
    public void updateProduct(Product product) {
        // 1. æ›´æ–°æ•°æ®åº“
        productService.update(product);
        
        // 2. æ›´æ–°Redisç¼“å­˜
        String key = "product:" + product.getId();
        jedis.setex(key, 3600, JSON.toJSONString(product));
        
        // 3. é€šçŸ¥æ‰€æœ‰èŠ‚ç‚¹æ¸…é™¤æœ¬åœ°ç¼“å­˜
        jedis.publish("cache:invalidate", key);
    }
}
```

### 5.4 çƒ­ç‚¹æ•°æ®æœ¬åœ°ç¼“å­˜ä¼˜åŒ–


**ğŸ”¥ çƒ­ç‚¹æ•°æ®ç‰¹æ®Šå¤„ç†**

```java
public class HotKeyLocalCache {
    
    // çƒ­ç‚¹æ•°æ®ä½¿ç”¨æ›´é•¿çš„æœ¬åœ°ç¼“å­˜æ—¶é—´
    public Object getWithHotKeyOptimization(String key) {
        boolean isHot = hotKeyDetector.isHotKey(key);
        
        if (isHot) {
            // çƒ­ç‚¹æ•°æ®ï¼šæœ¬åœ°ç¼“å­˜10åˆ†é’Ÿ
            Object value = localCache.get(key, k -> {
                String redisValue = jedis.get(k);
                return redisValue != null ? JSON.parseObject(redisValue, Object.class) : null;
            });
            return value;
        } else {
            // å†·æ•°æ®ï¼šæœ¬åœ°ç¼“å­˜1åˆ†é’Ÿæˆ–ä¸ç¼“å­˜
            return getFromRedisDirectly(key);
        }
    }
    
    // çƒ­ç‚¹æ•°æ®é¢„çƒ­åˆ°æœ¬åœ°ç¼“å­˜
    public void preloadHotKeysToLocal() {
        List<String> hotKeys = getHotKeyList();
        
        for (String hotKey : hotKeys) {
            try {
                String value = jedis.get(hotKey);
                if (value != null) {
                    localCache.put(hotKey, JSON.parseObject(value, Object.class));
                }
            } catch (Exception e) {
                log.warn("é¢„çƒ­çƒ­ç‚¹æ•°æ®å¤±è´¥: {}", hotKey, e);
            }
        }
    }
}
```

---

## 6. ğŸ”„ ç»¼åˆåº”ç”¨ç­–ç•¥


### 6.1 çƒ­ç‚¹æ•°æ®å¤„ç†å®Œæ•´æ–¹æ¡ˆ


**ğŸ—ï¸ çƒ­ç‚¹æ•°æ®å¤„ç†æ¶æ„**

```
                    å®¢æˆ·ç«¯è¯·æ±‚
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    è´Ÿè½½å‡è¡¡å™¨        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   åº”ç”¨æœåŠ¡å™¨é›†ç¾¤     â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”   â”‚
              â”‚  â”‚Node1â”‚ â”‚Node2â”‚   â”‚ â† æœ¬åœ°ç¼“å­˜
              â”‚  â”‚ L1  â”‚ â”‚ L1  â”‚   â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Redisé›†ç¾¤        â”‚ â† L2ç¼“å­˜+åˆ†ç‰‡
              â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”‚
              â”‚  â”‚S1 â”‚ â”‚S2 â”‚ â”‚S3 â”‚ â”‚
              â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚       æ•°æ®åº“        â”‚ â† L3æ•°æ®æº
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å†·çƒ­æ•°æ®åˆ†ç¦»ç­–ç•¥


**â„ï¸ å†·çƒ­åˆ†ç¦»å®ç°**

```java
@Service
public class DataTemperatureManager {
    
    // æ•°æ®æ¸©åº¦è¯„ä¼°
    public DataTemperature evaluateDataTemperature(String key) {
        // è·å–è®¿é—®ç»Ÿè®¡
        AccessStats stats = getAccessStats(key);
        
        if (stats.getRecentQps() > 100) {
            return DataTemperature.HOT;
        } else if (stats.getRecentQps() > 10) {
            return DataTemperature.WARM;  
        } else {
            return DataTemperature.COLD;
        }
    }
    
    // æ ¹æ®æ•°æ®æ¸©åº¦é€‰æ‹©å­˜å‚¨ç­–ç•¥
    public void storeByTemperature(String key, Object data) {
        DataTemperature temp = evaluateDataTemperature(key);
        
        switch (temp) {
            case HOT:
                // çƒ­ç‚¹æ•°æ®ï¼šåˆ†ç‰‡å­˜å‚¨ + æœ¬åœ°ç¼“å­˜ + é•¿æœŸç¼“å­˜
                storeHotData(key, data);
                break;
            case WARM:  
                // æ¸©æ•°æ®ï¼šRedisç¼“å­˜ + ä¸­ç­‰æ—¶é•¿
                storeWarmData(key, data);
                break;
            case COLD:
                // å†·æ•°æ®ï¼šçŸ­æœŸç¼“å­˜æˆ–ä¸ç¼“å­˜
                storeColdData(key, data);
                break;
        }
    }
    
    private void storeHotData(String key, Object data) {
        String json = JSON.toJSONString(data);
        
        // åˆ†ç‰‡å­˜å‚¨åˆ°Redis
        for (int i = 0; i < SHARD_COUNT; i++) {
            jedis.setex(key + ":shard:" + i, 7200, json); // 2å°æ—¶
        }
        
        // å­˜å‚¨åˆ°æœ¬åœ°ç¼“å­˜
        localCache.put(key, data);
        
        // æ ‡è®°ä¸ºçƒ­ç‚¹æ•°æ®
        jedis.sadd("hot_keys", key);
    }
}
```

### 6.3 åŠ¨æ€è°ƒæ•´æœºåˆ¶


**ğŸ“ˆ å®æ—¶è°ƒæ•´ç¼“å­˜ç­–ç•¥**

```java
public class DynamicCacheAdjuster {
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void adjustCacheStrategy() {
        Set<String> currentHotKeys = jedis.smembers("hot_keys");
        
        for (String key : currentHotKeys) {
            AccessStats stats = getRecentStats(key);
            
            // çƒ­åº¦ä¸‹é™ï¼Œå‡å°‘åˆ†ç‰‡æ•°é‡
            if (stats.getQps() < 50) {
                reduceSharding(key);
                jedis.srem("hot_keys", key);
                log.info("Key {} çƒ­åº¦ä¸‹é™ï¼Œå–æ¶ˆçƒ­ç‚¹å¤„ç†", key);
            }
        }
        
        // å‘ç°æ–°çš„çƒ­ç‚¹Key
        List<String> newHotKeys = detectNewHotKeys();
        for (String newHotKey : newHotKeys) {
            enableHotKeyHandling(newHotKey);
            jedis.sadd("hot_keys", newHotKey);
            log.info("æ£€æµ‹åˆ°æ–°çƒ­ç‚¹Key: {}", newHotKey);
        }
    }
    
    private void enableHotKeyHandling(String key) {
        // è·å–åŸå§‹æ•°æ®
        String originalData = jedis.get(key);
        if (originalData != null) {
            // åˆ›å»ºåˆ†ç‰‡
            for (int i = 0; i < SHARD_COUNT; i++) {
                jedis.setex(key + ":shard:" + i, 3600, originalData);
            }
            
            // é¢„åŠ è½½åˆ°æœ¬åœ°ç¼“å­˜
            Object data = JSON.parseObject(originalData, Object.class);
            localCache.put(key, data);
        }
    }
}
```

---

## 7. ğŸ¯ å®æˆ˜æ¡ˆä¾‹è¯¦è§£


### 7.1 ç”µå•†ç§’æ€åœºæ™¯


**âš¡ ç§’æ€æ´»åŠ¨çƒ­ç‚¹å¤„ç†**

```java
@Service
public class SeckillHotKeyHandler {
    
    // ç§’æ€å•†å“åº“å­˜çƒ­ç‚¹å¤„ç†
    public void prepareSeckillProduct(Long productId, int totalStock) {
        String stockKey = "seckill:stock:" + productId;
        
        // 1. åˆ†ç‰‡åº“å­˜ï¼Œé™ä½å•Keyå‹åŠ›
        int shardSize = totalStock / SHARD_COUNT;
        for (int i = 0; i < SHARD_COUNT; i++) {
            String shardKey = stockKey + ":shard:" + i;
            int shardStock = (i == SHARD_COUNT - 1) ? 
                totalStock - shardSize * i : shardSize; // æœ€åä¸€ä¸ªåˆ†ç‰‡åŒ…å«ä½™æ•°
            jedis.set(shardKey, String.valueOf(shardStock));
        }
        
        // 2. é¢„çƒ­å•†å“ä¿¡æ¯åˆ°æœ¬åœ°ç¼“å­˜
        Product product = productService.getById(productId);
        String productKey = "product:" + productId;
        jedis.setex(productKey, 3600, JSON.toJSONString(product));
        localCache.put(productKey, product);
        
        // 3. è®¾ç½®é™æµè§„åˆ™
        setupRateLimit(productId);
    }
    
    // ç§’æ€åº“å­˜æ‰£å‡
    public boolean deductStock(Long productId, Long userId) {
        // ç”¨æˆ·hashåˆ°å›ºå®šåˆ†ç‰‡
        int shardIndex = Math.abs(userId.hashCode()) % SHARD_COUNT;
        String shardKey = "seckill:stock:" + productId + ":shard:" + shardIndex;
        
        // åŸå­æ€§åº“å­˜æ‰£å‡
        String script = 
            "local stock = redis.call('GET', KEYS[1]) " +
            "if stock and tonumber(stock) > 0 then " +
            "  redis.call('DECR', KEYS[1]) " +
            "  return 1 " +
            "else " +
            "  return 0 " +
            "end";
            
        Object result = jedis.eval(script, Arrays.asList(shardKey), Arrays.asList());
        return "1".equals(result.toString());
    }
}
```

### 7.2 å®æ—¶çƒ­æ¦œæ•°æ®å¤„ç†


**ğŸ“ˆ çƒ­æ¦œæ•°æ®çƒ­ç‚¹ä¼˜åŒ–**

```java
public class TrendingDataHandler {
    
    // çƒ­æ¦œæ•°æ®è¯»å†™åˆ†ç¦»
    public void updateTrendingList(List<TrendingItem> items) {
        String writeKey = "trending:write:" + System.currentTimeMillis();
        String readKey = "trending:read";
        
        // 1. å†™å…¥ä¸´æ—¶Key
        String json = JSON.toJSONString(items);
        jedis.setex(writeKey, 300, json);
        
        // 2. åŸå­æ€§åˆ‡æ¢è¯»Key
        String script = 
            "local data = redis.call('GET', KEYS[1]) " +
            "if data then " +
            "  redis.call('SET', KEYS[2], data) " +
            "  redis.call('EXPIRE', KEYS[2], ARGV[1]) " +
            "  return 1 " +
            "else return 0 end";
            
        jedis.eval(script, Arrays.asList(writeKey, readKey), Arrays.asList("300"));
        
        // 3. åˆ†ç‰‡åˆ°å¤šä¸ªè¯»Key
        for (int i = 0; i < SHARD_COUNT; i++) {
            jedis.setex(readKey + ":shard:" + i, 300, json);
        }
        
        // 4. æ¸…ç†ä¸´æ—¶Key
        jedis.del(writeKey);
    }
    
    // é«˜å¹¶å‘è¯»å–çƒ­æ¦œ
    public List<TrendingItem> getTrendingList() {
        // éšæœºé€‰æ‹©è¯»åˆ†ç‰‡
        int shardIndex = ThreadLocalRandom.current().nextInt(SHARD_COUNT);
        String readKey = "trending:read:shard:" + shardIndex;
        
        String json = jedis.get(readKey);
        if (json != null) {
            return JSON.parseArray(json, TrendingItem.class);
        }
        
        // å…œåº•æ–¹æ¡ˆï¼šä»ä¸»Keyè¯»å–
        json = jedis.get("trending:read");
        return json != null ? JSON.parseArray(json, TrendingItem.class) : new ArrayList<>();
    }
}
```

### 7.3 ç”¨æˆ·ä¼šè¯çƒ­ç‚¹å¤„ç†


**ğŸ‘¤ å¤§Vç”¨æˆ·ä¼šè¯ä¼˜åŒ–**

```java
public class VipUserSessionHandler {
    
    // è¯†åˆ«VIPç”¨æˆ·å¹¶ç‰¹æ®Šå¤„ç†
    public void handleVipUserSession(Long userId) {
        boolean isVip = userService.isVipUser(userId);
        String sessionKey = "session:" + userId;
        
        if (isVip) {
            // VIPç”¨æˆ·ä¼šè¯æ•°æ®ï¼šåˆ†ç‰‡+æœ¬åœ°ç¼“å­˜
            shardVipSession(sessionKey);
            preloadToLocal(sessionKey);
            
            // è®¾ç½®æ›´é•¿çš„ç¼“å­˜æ—¶é—´
            for (int i = 0; i < SHARD_COUNT; i++) {
                jedis.expire(sessionKey + ":shard:" + i, 7200); // 2å°æ—¶
            }
        } else {
            // æ™®é€šç”¨æˆ·æ­£å¸¸å¤„ç†
            jedis.expire(sessionKey, 1800); // 30åˆ†é’Ÿ
        }
    }
    
    private void shardVipSession(String sessionKey) {
        String sessionData = jedis.get(sessionKey);
        if (sessionData != null) {
            // å¤åˆ¶åˆ°å¤šä¸ªåˆ†ç‰‡
            for (int i = 0; i < SHARD_COUNT; i++) {
                jedis.setex(sessionKey + ":shard:" + i, 7200, sessionData);
            }
        }
    }
}
```

---

## 8. ğŸ“Š ç›‘æ§ä¸è¿ç»´


### 8.1 çƒ­ç‚¹ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**

```java
@Component
public class HotKeyMonitor {
    
    @Scheduled(fixedRate = 30000) // æ¯30ç§’ç»Ÿè®¡ä¸€æ¬¡
    public void collectHotKeyMetrics() {
        Map<String, Object> metrics = new HashMap<>();
        
        // ç»Ÿè®¡çƒ­ç‚¹Keyæ•°é‡
        Long hotKeyCount = jedis.scard("hot_keys");
        metrics.put("hot_key_count", hotKeyCount);
        
        // ç»Ÿè®¡æœ¬åœ°ç¼“å­˜å‘½ä¸­ç‡
        CacheStats localStats = localCache.stats();
        metrics.put("local_cache_hit_rate", localStats.hitRate());
        
        // ç»Ÿè®¡Rediså‘½ä¸­ç‡
        String redisInfo = jedis.info("stats");
        // è§£ækeyspace_hitså’Œkeyspace_misses
        
        // ç»Ÿè®¡åˆ†ç‰‡æ•ˆæœ
        Set<String> hotKeys = jedis.smembers("hot_keys");
        for (String hotKey : hotKeys) {
            long totalQps = 0;
            for (int i = 0; i < SHARD_COUNT; i++) {
                totalQps += getKeyQps(hotKey + ":shard:" + i);
            }
            metrics.put(hotKey + "_total_qps", totalQps);
        }
        
        // å‘é€ç›‘æ§æ•°æ®
        sendMetricsToMonitor(metrics);
    }
}
```

### 8.2 è‡ªåŠ¨åŒ–è¿ç»´ç­–ç•¥


**ğŸ¤– æ™ºèƒ½è¿ç»´å®ç°**

```java
public class AutoHotKeyManager {
    
    // è‡ªåŠ¨å‘ç°å¹¶å¤„ç†çƒ­ç‚¹
    public void autoManageHotKeys() {
        // 1. æ‰«æå‘ç°æ–°çƒ­ç‚¹
        List<KeyStats> suspiciousKeys = findSuspiciousKeys();
        
        for (KeyStats stats : suspiciousKeys) {
            if (stats.getQps() > HOT_THRESHOLD) {
                // è‡ªåŠ¨å¯ç”¨çƒ­ç‚¹å¤„ç†
                enableHotKeyHandling(stats.getKey());
                
                // è®°å½•æ“ä½œæ—¥å¿—
                log.info("è‡ªåŠ¨å¯ç”¨çƒ­ç‚¹å¤„ç†: {} (QPS: {})", 
                        stats.getKey(), stats.getQps());
                
                // å‘é€å‘Šè­¦é€šçŸ¥
                alertService.sendHotKeyAlert(stats.getKey(), stats.getQps());
            }
        }
        
        // 2. æ£€æŸ¥ç°æœ‰çƒ­ç‚¹æ˜¯å¦éœ€è¦é™çº§
        checkAndDowngradeHotKeys();
    }
    
    private void enableHotKeyHandling(String key) {
        // è·å–åŸå§‹æ•°æ®
        String originalData = jedis.get(key);
        if (originalData == null) return;
        
        // åˆ›å»ºåˆ†ç‰‡
        for (int i = 0; i < SHARD_COUNT; i++) {
            String shardKey = key + ":shard:" + i;
            jedis.setex(shardKey, 3600, originalData);
        }
        
        // æ·»åŠ åˆ°çƒ­ç‚¹åˆ—è¡¨
        jedis.sadd("hot_keys", key);
        
        // é¢„çƒ­åˆ°æœ¬åœ°ç¼“å­˜
        try {
            Object data = JSON.parseObject(originalData, Object.class);
            localCache.put(key, data);
        } catch (Exception e) {
            log.warn("é¢„çƒ­åˆ°æœ¬åœ°ç¼“å­˜å¤±è´¥: {}", key);
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ çƒ­ç‚¹è¯†åˆ«ï¼šåŸºäºQPSã€å¹¶å‘æ•°ã€ä¸šåŠ¡é‡è¦æ€§ç»¼åˆè¯„ä¼°
ğŸ”¸ åˆ†ç‰‡ç­–ç•¥ï¼šå°†çƒ­ç‚¹Keyå¤åˆ¶æˆå¤šä»½ï¼Œåˆ†æ•£è®¿é—®å‹åŠ›
ğŸ”¸ æ‡’åŠ è½½ï¼šæŒ‰éœ€åŠ è½½æ•°æ®ï¼Œé¿å…å†…å­˜æµªè´¹
ğŸ”¸ æœ¬åœ°ç¼“å­˜ï¼šåˆ©ç”¨å†…å­˜é€Ÿåº¦ä¼˜åŠ¿ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿ
ğŸ”¸ å¤šçº§ç¼“å­˜ï¼šL1æœ¬åœ°+L2Redis+L3æ•°æ®åº“çš„å±‚æ¬¡ç»“æ„
ğŸ”¸ åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®å®æ—¶ç›‘æ§æ•°æ®è‡ªåŠ¨è°ƒæ•´ç¼“å­˜ç­–ç•¥
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ çƒ­ç‚¹æ•°æ®å¤„ç†çš„æ ¸å¿ƒæ€æƒ³**
```
åˆ†è€Œæ²»ä¹‹ï¼š
- åˆ†ç‰‡å‡å°‘å•ç‚¹å‹åŠ›
- å¤šå‰¯æœ¬æé«˜å¹¶å‘èƒ½åŠ›
- å°±è¿‘è®¿é—®é™ä½å»¶è¿Ÿ

å±‚æ¬¡åŒ–è®¾è®¡ï¼š
- ä¸åŒå±‚æ¬¡é€‚åˆä¸åŒæ¸©åº¦çš„æ•°æ®
- çƒ­æ•°æ®æ”¾åœ¨æ›´å¿«çš„å­˜å‚¨å±‚
- å†·æ•°æ®å¯ä»¥æ¥å—è¾ƒæ…¢çš„è®¿é—®
```

**ğŸ”¹ å†·çƒ­åˆ†ç¦»çš„å®é™…ä»·å€¼**
```
èµ„æºä¼˜åŒ–ï¼š
- çƒ­æ•°æ®å ç”¨ä¼˜è´¨èµ„æºï¼ˆå†…å­˜ã€SSDï¼‰
- å†·æ•°æ®ä½¿ç”¨å»‰ä»·èµ„æºï¼ˆç£ç›˜ã€ç½‘ç»œï¼‰
- æ•´ä½“æˆæœ¬é™ä½ï¼Œæ€§èƒ½æå‡

ç”¨æˆ·ä½“éªŒï¼š
- çƒ­ç‚¹åŠŸèƒ½å“åº”æå¿«
- é•¿å°¾åŠŸèƒ½æ€§èƒ½å¯æ¥å—
- æ•´ä½“ç³»ç»Ÿæ›´ç¨³å®š
```

### 9.3 å®æˆ˜åº”ç”¨æŒ‡å¯¼


**âœ… æœ€ä½³å®è·µ**
- å»ºç«‹å®Œå–„çš„çƒ­ç‚¹ç›‘æ§ä½“ç³»
- æ ¹æ®ä¸šåŠ¡åœºæ™¯å®šåˆ¶çƒ­ç‚¹é˜ˆå€¼
- é¢„æ¡ˆå‡†å¤‡ï¼šæå‰è¯†åˆ«å¯èƒ½çš„çƒ­ç‚¹
- æ¸è¿›å¼ä¼˜åŒ–ï¼šä»ç®€å•ç­–ç•¥å¼€å§‹é€æ­¥å®Œå–„

**âŒ å¸¸è§è¯¯åŒº**
- è¿‡åº¦ä¼˜åŒ–ï¼šä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½éœ€è¦åˆ†ç‰‡
- å¿½è§†ç›‘æ§ï¼šæ²¡æœ‰æ•°æ®æ”¯æ’‘çš„ä¼˜åŒ–æ˜¯ç›²ç›®çš„
- ä¸€åˆ€åˆ‡ï¼šå¯¹æ‰€æœ‰çƒ­ç‚¹ä½¿ç”¨ç›¸åŒç­–ç•¥
- é™æ€é…ç½®ï¼šä¸æ ¹æ®å®é™…æƒ…å†µåŠ¨æ€è°ƒæ•´

### 9.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸš€ ä¼˜åŒ–ç­–ç•¥è¦ç‚¹**
```
æˆæœ¬æ•ˆç›Šåˆ†æï¼š
- ä¼˜å…ˆä¼˜åŒ–å½±å“é¢æœ€å¤§çš„çƒ­ç‚¹
- è¯„ä¼°ä¼˜åŒ–æŠ•å…¥ä¸æ”¶ç›Š
- é¿å…è¿‡åº¦å·¥ç¨‹åŒ–

æŠ€æœ¯é€‰å‹ï¼š
- æœ¬åœ°ç¼“å­˜ï¼šCaffeineæ€§èƒ½æœ€ä½³
- åˆ†å¸ƒå¼ç¼“å­˜ï¼šRedisé›†ç¾¤æ¨¡å¼
- ç›‘æ§å·¥å…·ï¼šPrometheus + Grafana
- å‹æµ‹å·¥å…·ï¼šéªŒè¯ä¼˜åŒ–æ•ˆæœ
```

**ğŸ“Š ç›‘æ§å‘Šè­¦è®¾ç½®**
- **çƒ­ç‚¹é˜ˆå€¼**ï¼šQPS > 1000è§¦å‘å‘Šè­¦
- **ç¼“å­˜å‘½ä¸­ç‡**ï¼š< 80%éœ€è¦å…³æ³¨
- **å“åº”å»¶è¿Ÿ**ï¼š> 100mséœ€è¦ä¼˜åŒ–
- **å†…å­˜ä½¿ç”¨ç‡**ï¼š> 80%éœ€è¦æ‰©å®¹

> ğŸ’¡ **æ ¸å¿ƒè¦ç‚¹**ï¼šçƒ­ç‚¹æ•°æ®å¤„ç†ä¸æ˜¯ä¸€æ¬¡æ€§å·¥ç¨‹ï¼Œéœ€è¦æŒç»­ç›‘æ§å’Œä¼˜åŒ–ã€‚å…³é”®æ˜¯å»ºç«‹å®Œå–„çš„è¯†åˆ«ã€å¤„ç†ã€ç›‘æ§ä½“ç³»ï¼Œæ ¹æ®ä¸šåŠ¡å‘å±•åŠ¨æ€è°ƒæ•´ç­–ç•¥ã€‚

**æ ¸å¿ƒè®°å¿†**ï¼š
- çƒ­ç‚¹å†·ç‚¹è¦åˆ†æ¸…ï¼Œåˆ†ç‰‡ç¼“å­˜ç­–ç•¥æ˜
- æ‡’åŠ è½½èŠ‚çœèµ„æºï¼Œæœ¬åœ°ç¼“å­˜é€Ÿåº¦å¿«
- å¤šçº§æ¶æ„å±‚æ¬¡åŒ–ï¼ŒåŠ¨æ€è°ƒæ•´ä¿æ€§èƒ½
- ç›‘æ§è¿ç»´ä¸å¯å°‘ï¼Œæ•°æ®é©±åŠ¨ä¼˜åŒ–å¥½