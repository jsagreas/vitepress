---
title: 14ã€é«˜çº§åº”ç”¨æ¨¡å¼ä¸æ¶æ„è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡](#1-å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡)
2. [ç¼“å­˜é¢„çƒ­å’Œé™çº§ç­–ç•¥](#2-ç¼“å­˜é¢„çƒ­å’Œé™çº§ç­–ç•¥)
3. [æ•°æ®åŒæ­¥æ¨¡å¼](#3-æ•°æ®åŒæ­¥æ¨¡å¼)
4. [è¯»å†™åˆ†ç¦»æ¶æ„](#4-è¯»å†™åˆ†ç¦»æ¶æ„)
5. [ç¼“å­˜æ›´æ–°æ¨¡å¼](#5-ç¼“å­˜æ›´æ–°æ¨¡å¼)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡


### 1.1 å¤šçº§ç¼“å­˜åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¤šçº§ç¼“å­˜**
å¤šçº§ç¼“å­˜å°±åƒç°å®ä¸­çš„ä»“å‚¨ä½“ç³»ï¼Œè¶Šé è¿‘ç”¨æˆ·çš„ä»“åº“å®¹é‡è¶Šå°ä½†é€Ÿåº¦è¶Šå¿«ï¼š

```
ç°å®ä»“å‚¨ä½“ç³»ï¼š                     å¤šçº§ç¼“å­˜ä½“ç³»ï¼š
ç”¨æˆ· â†’ ä¾¿åˆ©åº—(å°è€Œå¿«)              åº”ç”¨ â†’ L1æœ¬åœ°ç¼“å­˜(å°è€Œå¿«)
     â†’ è¶…å¸‚(ä¸­ç­‰)           VS           â†’ L2 Redisç¼“å­˜(ä¸­ç­‰)  
     â†’ ä»“åº“(å¤§è€Œæ…¢)                      â†’ L3 æ•°æ®åº“(å¤§è€Œæ…¢)

æ ¸å¿ƒæ€æƒ³ï¼šæ•°æ®æŒ‰è®¿é—®é¢‘ç‡åˆ†å±‚å­˜å‚¨ï¼Œçƒ­ç‚¹æ•°æ®æ”¾åœ¨æœ€å¿«çš„å±‚çº§
```

### 1.2 L1/L2ç¼“å­˜æ¶æ„è®¾è®¡


**ğŸ”¸ L1ç¼“å­˜ - æœ¬åœ°å†…å­˜ç¼“å­˜**
```
ç‰¹ç‚¹ï¼šåº”ç”¨è¿›ç¨‹å†…å­˜ä¸­çš„ç¼“å­˜
ä¼˜åŠ¿ï¼šè®¿é—®é€Ÿåº¦æœ€å¿«(å¾®ç§’çº§)ï¼Œæ— ç½‘ç»œå¼€é”€
åŠ£åŠ¿ï¼šå®¹é‡æœ‰é™ï¼Œå¤šå®ä¾‹é—´æ— æ³•å…±äº«
é€‚ç”¨ï¼šè¶…çƒ­ç‚¹æ•°æ®ï¼Œé…ç½®ä¿¡æ¯ï¼Œè®¡ç®—ç»“æœ
```

**ğŸ”¸ L2ç¼“å­˜ - Redisåˆ†å¸ƒå¼ç¼“å­˜**  
```
ç‰¹ç‚¹ï¼šç‹¬ç«‹çš„RedisæœåŠ¡å™¨é›†ç¾¤
ä¼˜åŠ¿ï¼šå®¹é‡å¤§ï¼Œæ”¯æŒé›†ç¾¤ï¼Œå¤šå®ä¾‹å…±äº«
åŠ£åŠ¿ï¼šæœ‰ç½‘ç»œå»¶è¿Ÿ(æ¯«ç§’çº§)
é€‚ç”¨ï¼šçƒ­ç‚¹æ•°æ®ï¼Œä¼šè¯ä¿¡æ¯ï¼Œä¸šåŠ¡ç¼“å­˜
```

**ğŸ“Š å¤šçº§ç¼“å­˜æ¶æ„å›¾**
```
                    ç”¨æˆ·è¯·æ±‚
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   åº”ç”¨æœåŠ¡å™¨     â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
              â”‚  â”‚ L1æœ¬åœ°ç¼“å­˜   â”‚ â”‚ â† å‘½ä¸­ç‡85%ï¼Œå“åº”<1ms
              â”‚  â”‚(JVMå †å†…å­˜)  â”‚ â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ L1 Miss
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Redisé›†ç¾¤     â”‚ â† å‘½ä¸­ç‡95%ï¼Œå“åº”<10ms
              â”‚  (L2åˆ†å¸ƒå¼ç¼“å­˜) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ L2 Miss
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   MySQLæ•°æ®åº“   â”‚ â† æœ€ç»ˆæ•°æ®æºï¼Œå“åº”>50ms
              â”‚  (æŒä¹…åŒ–å­˜å‚¨)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 å¤šçº§ç¼“å­˜å®ç°ç­–ç•¥


**ğŸ“ ä»£ç å®ç°ç¤ºä¾‹**
```java
@Service
public class MultiLevelCacheService {
    // L1ç¼“å­˜ - æœ¬åœ°å†…å­˜
    private Map<String, Object> l1Cache = new ConcurrentHashMap<>();
    private static final int L1_MAX_SIZE = 1000;
    
    // L2ç¼“å­˜ - Redis
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // æ•°æ®æº
    @Autowired  
    private UserMapper userMapper;
    
    public User getUser(String userId) {
        // æ­¥éª¤1ï¼šå°è¯•L1ç¼“å­˜
        User user = (User) l1Cache.get("user:" + userId);
        if (user != null) {
            return user; // L1å‘½ä¸­ï¼Œç›´æ¥è¿”å›
        }
        
        // æ­¥éª¤2ï¼šå°è¯•L2ç¼“å­˜(Redis)
        user = (User) redisTemplate.opsForValue().get("user:" + userId);
        if (user != null) {
            // L2å‘½ä¸­ï¼Œå›å¡«L1ç¼“å­˜
            putToL1Cache("user:" + userId, user);
            return user;
        }
        
        // æ­¥éª¤3ï¼šæŸ¥è¯¢æ•°æ®åº“
        user = userMapper.selectById(userId);
        if (user != null) {
            // å›å¡«L2å’ŒL1ç¼“å­˜
            redisTemplate.opsForValue().set("user:" + userId, user, 1, TimeUnit.HOURS);
            putToL1Cache("user:" + userId, user);
        }
        
        return user;
    }
    
    private void putToL1Cache(String key, Object value) {
        if (l1Cache.size() >= L1_MAX_SIZE) {
            // ç®€å•LRUï¼šåˆ é™¤æœ€è€çš„æ¡ç›®
            l1Cache.remove(l1Cache.keySet().iterator().next());
        }
        l1Cache.put(key, value);
    }
}
```

### 1.4 ç¼“å­˜å‘½ä¸­ç‡ä¼˜åŒ–


**ğŸ“Š ç¼“å­˜å‘½ä¸­ç‡åˆ†æ**

| ç¼“å­˜å±‚çº§ | **å…¸å‹å‘½ä¸­ç‡** | **å“åº”æ—¶é—´** | **æˆæœ¬** | **å®¹é‡** |
|---------|---------------|-------------|---------|---------|
| ğŸƒ **L1æœ¬åœ°** | `80-90%` | `<1ms` | `å†…å­˜æˆæœ¬é«˜` | `100MB-1GB` |
| ğŸŒ **L2 Redis** | `90-98%` | `1-10ms` | `æœåŠ¡å™¨æˆæœ¬` | `1GB-100GB` |
| ğŸ’¾ **æ•°æ®åº“** | `100%` | `50-200ms` | `IOæˆæœ¬é«˜` | `æ— é™åˆ¶` |

**ğŸ’¡ ä¼˜åŒ–ç­–ç•¥**
```
L1ç¼“å­˜ä¼˜åŒ–ï¼š
â€¢ ç¼“å­˜è¶…çƒ­ç‚¹æ•°æ®ï¼ˆè®¿é—®é¢‘ç‡æœ€é«˜çš„5%ï¼‰
â€¢ è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼ˆé¿å…æ•°æ®è¿‡æœŸï¼‰
â€¢ ä½¿ç”¨LRUç®—æ³•ç®¡ç†ç¼“å­˜å®¹é‡

L2ç¼“å­˜ä¼˜åŒ–ï¼š
â€¢ ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆè®¿é—®é¢‘ç‡å‰20%ï¼‰
â€¢ è®¾ç½®é€‚å½“çš„è¿‡æœŸæ—¶é—´ï¼ˆå¹³è¡¡ä¸€è‡´æ€§å’Œæ€§èƒ½ï¼‰
â€¢ é¢„çƒ­å…³é”®æ•°æ®

æ•°æ®ä¸€è‡´æ€§ï¼š
â€¢ L1è®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´ï¼ˆ5-15åˆ†é’Ÿï¼‰
â€¢ L2è®¾ç½®é€‚ä¸­è¿‡æœŸæ—¶é—´ï¼ˆ30åˆ†é’Ÿ-2å°æ—¶ï¼‰
â€¢ æ•°æ®æ›´æ–°æ—¶ä¸»åŠ¨æ¸…é™¤ç¼“å­˜
```

---

## 2. ğŸš€ ç¼“å­˜é¢„çƒ­å’Œé™çº§ç­–ç•¥


### 2.1 ç¼“å­˜é¢„çƒ­ç­–ç•¥


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­**
ç¼“å­˜é¢„çƒ­å°±åƒå†¬å¤©æå‰çƒ§å¥½çƒ­æ°´ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶æå‰æŠŠçƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œé¿å…ç”¨æˆ·è®¿é—®æ—¶å‡ºç°"å†·å¯åŠ¨"é—®é¢˜ã€‚

**ğŸ’¡ é¢„çƒ­çš„å¿…è¦æ€§**
```
é—®é¢˜åœºæ™¯ï¼š
ç³»ç»Ÿé‡å¯åç¼“å­˜ä¸ºç©º â†’ æ‰€æœ‰è¯·æ±‚éƒ½å»æŸ¥æ•°æ®åº“ â†’ æ•°æ®åº“ç¬é—´å‹åŠ›å·¨å¤§ â†’ å¯èƒ½å¯¼è‡´é›ªå´©

è§£å†³æ€è·¯ï¼š
ç³»ç»Ÿå¯åŠ¨æ—¶ä¸»åŠ¨åŠ è½½çƒ­ç‚¹æ•°æ® â†’ ç”¨æˆ·è®¿é—®æ—¶ç›´æ¥å‘½ä¸­ç¼“å­˜ â†’ å¹³ç¨³åº¦è¿‡å¯åŠ¨æœŸ
```

### 2.2 é¢„çƒ­å®ç°ç­–ç•¥


**ğŸ“ åˆ†ç±»é¢„çƒ­å®ç°**
```java
@Component
public class CacheWarmUpService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Autowired
    private ProductService productService;
    
    // ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œé¢„çƒ­
    @PostConstruct
    public void warmUpCache() {
        log.info("å¼€å§‹ç¼“å­˜é¢„çƒ­...");
        
        // é¢„çƒ­çƒ­é—¨å•†å“
        warmUpHotProducts();
        
        // é¢„çƒ­ç³»ç»Ÿé…ç½®
        warmUpSystemConfig();
        
        // é¢„çƒ­ç”¨æˆ·ç”»åƒ
        warmUpUserProfiles();
        
        log.info("ç¼“å­˜é¢„çƒ­å®Œæˆ");
    }
    
    private void warmUpHotProducts() {
        // è·å–çƒ­é—¨å•†å“IDåˆ—è¡¨
        List<String> hotProductIds = productService.getHotProductIds();
        
        for (String productId : hotProductIds) {
            try {
                // åŠ è½½å•†å“è¯¦æƒ…åˆ°ç¼“å­˜
                Product product = productService.getProductFromDB(productId);
                String cacheKey = "product:" + productId;
                redisTemplate.opsForValue().set(cacheKey, product, 2, TimeUnit.HOURS);
                
                Thread.sleep(10); // é¿å…DBå‹åŠ›è¿‡å¤§
            } catch (Exception e) {
                log.error("é¢„çƒ­å•†å“å¤±è´¥: " + productId, e);
            }
        }
    }
    
    private void warmUpSystemConfig() {
        // é¢„çƒ­ç³»ç»Ÿé…ç½®ï¼ˆè¿™ç±»æ•°æ®å˜æ›´é¢‘ç‡ä½ï¼Œå¯ä»¥é•¿æ—¶é—´ç¼“å­˜ï¼‰
        Map<String, String> configs = systemConfigService.getAllConfigs();
        redisTemplate.opsForHash().putAll("system:config", configs);
    }
}
```

### 2.3 ç¼“å­˜é™çº§ç­–ç•¥


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç¼“å­˜é™çº§**
å½“ç¼“å­˜ç³»ç»Ÿå‡ºç°æ•…éšœæ—¶ï¼Œåº”ç”¨è¦èƒ½ä¼˜é›…åœ°"é™çº§"åˆ°ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå°±åƒç”µæ¢¯åäº†æ”¹èµ°æ¥¼æ¢¯ã€‚

**ğŸ“Š é™çº§ç­–ç•¥å±‚æ¬¡**
```
é™çº§çº§åˆ«åˆ†æï¼š

æ­£å¸¸çŠ¶æ€ï¼š
åº”ç”¨ â†’ Redisç¼“å­˜ â†’ æ•°æ®åº“
æ€§èƒ½ï¼šä¼˜ç§€ï¼Œå“åº”<10ms

ä¸€çº§é™çº§ï¼ˆRedisæ•…éšœï¼‰ï¼š
åº”ç”¨ â†’ ç›´æ¥è®¿é—®æ•°æ®åº“
æ€§èƒ½ï¼šä¸­ç­‰ï¼Œå“åº”50-200ms

äºŒçº§é™çº§ï¼ˆæ•°æ®åº“æ…¢ï¼‰ï¼š
åº”ç”¨ â†’ è¿”å›é»˜è®¤æ•°æ®æˆ–é™æ€æ•°æ®
æ€§èƒ½ï¼šåŸºæœ¬å¯ç”¨

ä¸‰çº§é™çº§ï¼ˆç³»ç»Ÿå¼‚å¸¸ï¼‰ï¼š
åº”ç”¨ â†’ è¿”å›é”™è¯¯é¡µé¢ï¼Œä¿æŠ¤æ ¸å¿ƒåŠŸèƒ½
æ€§èƒ½ï¼šæœ€ä½å¯ç”¨
```

**ğŸ“ é™çº§å®ç°ä»£ç **
```java
@Service
public class CacheDegradationService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Autowired
    private UserMapper userMapper;
    
    // é™çº§å¼€å…³
    @Value("${cache.degradation.enabled:false}")
    private boolean degradationEnabled;
    
    public User getUser(String userId) {
        try {
            // æ­£å¸¸æµç¨‹ï¼šå…ˆæŸ¥Redis
            if (!degradationEnabled) {
                User user = getFromRedis(userId);
                if (user != null) {
                    return user;
                }
            }
            
            // Redis missæˆ–é™çº§æ—¶æŸ¥æ•°æ®åº“
            User user = userMapper.selectById(userId);
            
            // å¦‚æœRedisæ­£å¸¸ï¼Œå›å†™ç¼“å­˜
            if (!degradationEnabled && user != null) {
                setToRedis(userId, user);
            }
            
            return user;
            
        } catch (Exception e) {
            log.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥", e);
            
            // å¼‚å¸¸é™çº§ï¼šè¿”å›åŸºæœ¬ä¿¡æ¯
            return getUserFallback(userId);
        }
    }
    
    private User getUserFallback(String userId) {
        // è¿”å›æœ€åŸºæœ¬çš„ç”¨æˆ·ä¿¡æ¯
        User fallbackUser = new User();
        fallbackUser.setId(userId);
        fallbackUser.setName("ç”¨æˆ·" + userId);
        fallbackUser.setStatus("unknown");
        return fallbackUser;
    }
}
```

### 2.4 é¢„çƒ­å’Œé™çº§çš„é…åˆä½¿ç”¨


**ğŸ”„ ç³»ç»Ÿå¯åŠ¨æµç¨‹**
```
ç³»ç»Ÿå¯åŠ¨å®Œæ•´æµç¨‹ï¼š

ç¬¬1é˜¶æ®µï¼šåŸºç¡€æœåŠ¡å¯åŠ¨
â”œâ”€ æ•°æ®åº“è¿æ¥åˆå§‹åŒ–
â”œâ”€ Redisè¿æ¥å»ºç«‹
â””â”€ åŸºç¡€ç»„ä»¶åŠ è½½

ç¬¬2é˜¶æ®µï¼šç¼“å­˜é¢„çƒ­
â”œâ”€ çƒ­ç‚¹æ•°æ®é¢„åŠ è½½
â”œâ”€ ç³»ç»Ÿé…ç½®é¢„çƒ­  
â””â”€ ç”¨æˆ·ç”»åƒé¢„çƒ­

ç¬¬3é˜¶æ®µï¼šæµé‡æ¥å…¥
â”œâ”€ å¥åº·æ£€æŸ¥é€šè¿‡
â”œâ”€ è´Ÿè½½å‡è¡¡ç”Ÿæ•ˆ
â””â”€ æ­£å¼å¯¹å¤–æœåŠ¡

é™çº§è§¦å‘ç‚¹ï¼š
â€¢ Redisè¿æ¥å¤±è´¥ â†’ å¯ç”¨ä¸€çº§é™çº§
â€¢ æ•°æ®åº“å“åº”æ…¢ â†’ å¯ç”¨äºŒçº§é™çº§
â€¢ ç³»ç»Ÿå¼‚å¸¸ â†’ å¯ç”¨ä¸‰çº§é™çº§
```

---

## 3. ğŸ”„ æ•°æ®åŒæ­¥æ¨¡å¼


### 3.1 æ•°æ®åŒæ­¥åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åŒæ­¥**
Redisä½œä¸ºç¼“å­˜ï¼Œæ•°æ®æœ€ç»ˆè¿˜æ˜¯è¦å’Œæ•°æ®åº“ä¿æŒä¸€è‡´ã€‚å°±åƒå•†åº—çš„ä»·æ ¼æ ‡ç­¾è¦å’Œæ”¶é“¶ç³»ç»Ÿä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚

```
æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼š
ç¼“å­˜ä¸­ï¼šå•†å“ä»·æ ¼999å…ƒ
æ•°æ®åº“ä¸­ï¼šå•†å“ä»·æ ¼1099å…ƒ
ç»“æœï¼šç”¨æˆ·çœ‹åˆ°999ä½†å®é™…è¦ä»˜1099ï¼Œäº§ç”Ÿçº çº·
```

### 3.2 åŒæ­¥ç­–ç•¥åˆ†ç±»


**ğŸ“Š å››ç§ä¸»è¦åŒæ­¥ç­–ç•¥**

| åŒæ­¥ç­–ç•¥ | **å®ç°æ–¹å¼** | **ä¸€è‡´æ€§** | **æ€§èƒ½** | **å¤æ‚åº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|-----------|---------|-----------|-------------|
| ğŸ”„ **åŒæ­¥åŒå†™** | `åŒæ—¶æ›´æ–°DBå’Œç¼“å­˜` | `å¼ºä¸€è‡´` | `è¾ƒä½` | `ç®€å•` | `å°æ•°æ®é‡` |
| âš¡ **å¼‚æ­¥åˆ·æ–°** | `å…ˆæ›´æ–°DBï¼Œåå°å¼‚æ­¥æ›´æ–°ç¼“å­˜` | `æœ€ç»ˆä¸€è‡´` | `é«˜` | `ä¸­ç­‰` | `å¤§å¤šæ•°åœºæ™¯` |
| ğŸ“¨ **æ¶ˆæ¯åŒæ­¥** | `DBæ›´æ–°è§¦å‘æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ›´æ–°ç¼“å­˜` | `æœ€ç»ˆä¸€è‡´` | `é«˜` | `å¤æ‚` | `åˆ†å¸ƒå¼ç³»ç»Ÿ` |
| ğŸ• **å®šæ—¶åŒæ­¥** | `å®šæ—¶ä»»åŠ¡æ‰¹é‡åŒæ­¥æ•°æ®` | `å¼±ä¸€è‡´` | `ä¸­ç­‰` | `ç®€å•` | `å®æ—¶æ€§è¦æ±‚ä½` |

### 3.3 åŒæ­¥åŒå†™æ¨¡å¼è¯¦è§£


**ğŸ”¸ å®ç°åŸç†**
æ•°æ®æ›´æ–°æ—¶ï¼ŒåŒæ—¶æ›´æ–°æ•°æ®åº“å’ŒRedisç¼“å­˜ï¼Œä¿è¯å¼ºä¸€è‡´æ€§ï¼š

```java
@Service
public class SyncDoubleWriteService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Transactional
    public void updateUser(User user) {
        try {
            // æ­¥éª¤1ï¼šæ›´æ–°æ•°æ®åº“
            userMapper.updateById(user);
            
            // æ­¥éª¤2ï¼šæ›´æ–°Redisç¼“å­˜
            String cacheKey = "user:" + user.getId();
            redisTemplate.opsForValue().set(cacheKey, user, 1, TimeUnit.HOURS);
            
        } catch (Exception e) {
            // ä»»ä¸€æ­¥éª¤å¤±è´¥éƒ½å›æ»š
            log.error("ç”¨æˆ·æ›´æ–°å¤±è´¥", e);
            throw new RuntimeException("æ›´æ–°å¤±è´¥");
        }
    }
}
```

**âš ï¸ åŒæ­¥åŒå†™çš„é—®é¢˜**
```
é—®é¢˜1ï¼šæ€§èƒ½å½±å“
â€¢ æ¯æ¬¡å†™æ“ä½œéœ€è¦ç­‰å¾…ä¸¤ä¸ªå­˜å‚¨ç³»ç»Ÿéƒ½æˆåŠŸ
â€¢ å“åº”æ—¶é—´ = DBå“åº”æ—¶é—´ + Rediså“åº”æ—¶é—´

é—®é¢˜2ï¼šä¸€è‡´æ€§é£é™©  
â€¢ å¦‚æœDBæˆåŠŸä½†Rediså¤±è´¥ï¼Œæ•°æ®ä¸ä¸€è‡´
â€¢ éœ€è¦äº‹åŠ¡æœºåˆ¶æˆ–è¡¥å¿æœºåˆ¶

é—®é¢˜3ï¼šå¯ç”¨æ€§å½±å“
â€¢ ä»»ä¸€ç³»ç»Ÿæ•…éšœéƒ½å½±å“å†™æ“ä½œ
â€¢ é™ä½äº†ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§
```

### 3.4 å¼‚æ­¥åˆ·æ–°æ¨¡å¼


**ğŸ”¸ å®ç°æ€è·¯**
å…ˆæ›´æ–°æ•°æ®åº“ç¡®ä¿æ•°æ®å®‰å…¨ï¼Œå†å¼‚æ­¥æ›´æ–°ç¼“å­˜æé«˜æ€§èƒ½ï¼š

```java
@Service
public class AsyncRefreshService {
    
    @Autowired
    private ThreadPoolExecutor asyncExecutor;
    
    public void updateUser(User user) {
        try {
            // æ­¥éª¤1ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼ˆå…³é”®ä¸šåŠ¡ï¼‰
            userMapper.updateById(user);
            
            // æ­¥éª¤2ï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
            asyncExecutor.execute(() -> {
                try {
                    String cacheKey = "user:" + user.getId();
                    redisTemplate.opsForValue().set(cacheKey, user, 1, TimeUnit.HOURS);
                } catch (Exception e) {
                    log.error("å¼‚æ­¥æ›´æ–°ç¼“å­˜å¤±è´¥", e);
                    // å¯ä»¥åŠ å…¥é‡è¯•é˜Ÿåˆ—
                }
            });
            
        } catch (Exception e) {
            log.error("æ›´æ–°æ•°æ®åº“å¤±è´¥", e);
            throw e;
        }
    }
}
```

### 3.5 æ¶ˆæ¯é©±åŠ¨åŒæ­¥æ¨¡å¼


**ğŸ”¸ åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„åŒæ­¥**
å½“æ•°æ®åº“å‘ç”Ÿå˜æ›´æ—¶ï¼Œå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç¼“å­˜æœåŠ¡ç›‘å¬æ¶ˆæ¯å¹¶æ›´æ–°ï¼š

```
æ•°æ®å˜æ›´æµç¨‹ï¼š
åº”ç”¨æœåŠ¡ â†’ æ›´æ–°æ•°æ®åº“ â†’ å‘é€å˜æ›´æ¶ˆæ¯ â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ ç¼“å­˜åŒæ­¥æœåŠ¡ â†’ æ›´æ–°Redis

ä¼˜åŠ¿ï¼š
â€¢ è§£è€¦ï¼šæ•°æ®åº“å’Œç¼“å­˜æ“ä½œåˆ†ç¦»
â€¢ å¯é æ€§ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¿è¯å¯é æŠ•é€’
â€¢ æ‰©å±•æ€§ï¼šå¯ä»¥å¤šä¸ªç¼“å­˜æœåŠ¡æ¶ˆè´¹åŒä¸€æ¶ˆæ¯
```

```java
// æ¶ˆæ¯å‘é€è€…
@Service
public class DataChangePublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void updateUser(User user) {
        // æ›´æ–°æ•°æ®åº“
        userMapper.updateById(user);
        
        // å‘é€å˜æ›´æ¶ˆæ¯
        DataChangeMessage message = new DataChangeMessage();
        message.setType("USER_UPDATE");
        message.setUserId(user.getId());
        message.setData(user);
        
        rabbitTemplate.convertAndSend("data.change", message);
    }
}

// æ¶ˆæ¯æ¶ˆè´¹è€…
@Component
public class CacheUpdateListener {
    
    @RabbitListener(queues = "cache.update")
    public void handleDataChange(DataChangeMessage message) {
        if ("USER_UPDATE".equals(message.getType())) {
            // æ›´æ–°ç”¨æˆ·ç¼“å­˜
            String cacheKey = "user:" + message.getUserId();
            redisTemplate.opsForValue().set(cacheKey, message.getData(), 1, TimeUnit.HOURS);
        }
    }
}
```

---

## 4. ğŸ“– è¯»å†™åˆ†ç¦»æ¶æ„


### 4.1 è¯»å†™åˆ†ç¦»åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¯»å†™åˆ†ç¦»**
è¯»å†™åˆ†ç¦»å°±åƒå›¾ä¹¦é¦†çš„ç®¡ç†æ¨¡å¼ï¼šå†™æ“ä½œï¼ˆæ–°ä¹¦å…¥åº“ï¼‰åœ¨ç®¡ç†å‘˜åŠå…¬å®¤è¿›è¡Œï¼Œè¯»æ“ä½œï¼ˆå€Ÿä¹¦çœ‹ä¹¦ï¼‰åœ¨é˜…è§ˆå®¤è¿›è¡Œï¼Œåˆ†å·¥æ˜ç¡®æé«˜æ•ˆç‡ã€‚

```
è¯»å†™åˆ†ç¦»æ¶æ„ï¼š
                    åº”ç”¨å±‚
                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   è·¯ç”±å†³ç­–å™¨     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†™           â†˜
        å†™æ“ä½œèµ°ä¸»åº“      è¯»æ“ä½œèµ°ä»åº“
              â†“               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Redisä¸»åº“   â”‚   â”‚ Redisä»åº“   â”‚
    â”‚ (Master)    â”‚â”€â”€â”€â†’â”‚ (Slave)     â”‚
    â”‚ å¤„ç†å†™è¯·æ±‚   â”‚   â”‚ å¤„ç†è¯»è¯·æ±‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘
      æ•°æ®åŒæ­¥å¤åˆ¶
```

### 4.2 Redisä¸»ä»å¤åˆ¶åŸç†


**ğŸ”¸ ä¸»ä»å¤åˆ¶æœºåˆ¶**
```
å¤åˆ¶è¿‡ç¨‹ï¼š
1. ä»åº“è¿æ¥ä¸»åº“ï¼Œå‘é€SYNCå‘½ä»¤
2. ä¸»åº“æ‰§è¡ŒBGSAVEï¼Œç”ŸæˆRDBå¿«ç…§
3. ä¸»åº“å°†å¿«ç…§æ–‡ä»¶å‘é€ç»™ä»åº“
4. ä»åº“åŠ è½½å¿«ç…§ï¼Œæ¢å¤æ•°æ®
5. ä¸»åº“æŒç»­å‘é€å¢é‡å‘½ä»¤ç»™ä»åº“

å®æ—¶åŒæ­¥ï¼š
ä¸»åº“æ¯æ¬¡å†™æ“ä½œ â†’ åŒæ—¶è®°å½•åˆ°å¤åˆ¶ç¼“å†²åŒº â†’ å‘é€ç»™æ‰€æœ‰ä»åº“
```

**ğŸ“ ä¸»ä»é…ç½®ç¤ºä¾‹**
```bash
# ä¸»åº“é…ç½® (redis-master.conf)
port 6379
bind 0.0.0.0
# è®¾ç½®å¤åˆ¶å¯†ç 
requirepass master123
masterauth master123

# ä»åº“é…ç½® (redis-slave.conf) 
port 6380
bind 0.0.0.0
# æŒ‡å®šä¸»åº“åœ°å€
replicaof 192.168.1.100 6379
# ä¸»åº“å¯†ç 
masterauth master123
# ä»åº“åªè¯»
replica-read-only yes
```

### 4.3 è¯»å†™åˆ†ç¦»å®ç°


**ğŸ“ åº”ç”¨å±‚è¯»å†™åˆ†ç¦»**
```java
@Configuration
public class RedisConfig {
    
    // ä¸»åº“é…ç½®ï¼ˆå†™æ“ä½œï¼‰
    @Bean("masterRedisTemplate")
    public RedisTemplate<String, Object> masterRedisTemplate() {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(masterConnectionFactory());
        return template;
    }
    
    // ä»åº“é…ç½®ï¼ˆè¯»æ“ä½œï¼‰
    @Bean("slaveRedisTemplate")  
    public RedisTemplate<String, Object> slaveRedisTemplate() {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(slaveConnectionFactory());
        return template;
    }
}

@Service
public class RedisReadWriteService {
    
    @Qualifier("masterRedisTemplate")
    @Autowired
    private RedisTemplate<String, Object> masterRedis;
    
    @Qualifier("slaveRedisTemplate")
    @Autowired  
    private RedisTemplate<String, Object> slaveRedis;
    
    // å†™æ“ä½œä½¿ç”¨ä¸»åº“
    public void setUser(String userId, User user) {
        String key = "user:" + userId;
        masterRedis.opsForValue().set(key, user, 1, TimeUnit.HOURS);
    }
    
    // è¯»æ“ä½œä½¿ç”¨ä»åº“
    public User getUser(String userId) {
        String key = "user:" + userId;
        return (User) slaveRedis.opsForValue().get(key);
    }
}
```

### 4.4 è¯»å†™åˆ†ç¦»æ³¨æ„äº‹é¡¹


**âš ï¸ æ•°æ®å»¶è¿Ÿé—®é¢˜**
```
ä¸»ä»å¤åˆ¶å»¶è¿Ÿï¼š
ä¸»åº“å†™å…¥æ•°æ® â†’ ä»åº“åŒæ­¥æ•°æ®ï¼ˆæœ‰å»¶è¿Ÿï¼‰
å…¸å‹å»¶è¿Ÿï¼šå‡ æ¯«ç§’åˆ°å‡ ç§’

è§£å†³æ–¹æ¡ˆï¼š
1. å¼ºä¸€è‡´æ€§è¯»ï¼šé‡è¦æ“ä½œåçŸ­æ—¶é—´å†…è¯»ä¸»åº“
2. æœ€ç»ˆä¸€è‡´æ€§ï¼šä¸€èˆ¬è¯»æ“ä½œå¯ä»¥æ¥å—çŸ­æš‚å»¶è¿Ÿ
3. è¯»ä¸»å†™ä¸»ï¼šå…³é”®ä¸šåŠ¡çš„è¯»å†™éƒ½èµ°ä¸»åº“
```

```java
public User getUserWithConsistency(String userId, boolean strongConsistent) {
    if (strongConsistent) {
        // å¼ºä¸€è‡´æ€§è¦æ±‚ï¼Œè¯»ä¸»åº“
        return (User) masterRedis.opsForValue().get("user:" + userId);
    } else {
        // å¯ä»¥æ¥å—å»¶è¿Ÿï¼Œè¯»ä»åº“
        return (User) slaveRedis.opsForValue().get("user:" + userId);
    }
}
```

---

## 5. ğŸ”„ ç¼“å­˜æ›´æ–°æ¨¡å¼


### 5.1 ç¼“å­˜æ›´æ–°ç­–ç•¥å¯¹æ¯”


**ğŸ”¸ ä¸‰ç§ä¸»è¦æ›´æ–°æ¨¡å¼**

```
æ›´æ–°æ¨¡å¼é€‰æ‹©ï¼š

å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼š
é—®é¢˜ï¼šå¦‚æœDBæ›´æ–°å¤±è´¥ï¼Œç¼“å­˜æˆè„æ•°æ®
é£é™©ï¼šé«˜é£é™©ï¼Œä¸æ¨è

å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼š
é—®é¢˜ï¼šå¦‚æœç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œå‡ºç°ä¸ä¸€è‡´
é£é™©ï¼šä¸­ç­‰é£é™©

å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼š
é—®é¢˜ï¼šçŸ­æš‚çš„ç¼“å­˜miss
é£é™©ï¼šä½é£é™©ï¼Œæ¨èä½¿ç”¨ âœ…
```

### 5.2 å…ˆåˆ åå†™æ¨¡å¼è¯¦è§£


**ğŸ”¸ åŸºæœ¬æ€è·¯**
æ›´æ–°æ•°æ®æ—¶å…ˆåˆ é™¤ç¼“å­˜ï¼Œè®©åç»­è¯·æ±‚é‡æ–°ä»æ•°æ®åº“åŠ è½½æœ€æ–°æ•°æ®ï¼š

```
å…ˆåˆ åå†™æµç¨‹ï¼š
1. åˆ é™¤Redisä¸­çš„ç¼“å­˜æ•°æ®
2. æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®  
3. åç»­è¯»è¯·æ±‚å‘ç°ç¼“å­˜ä¸å­˜åœ¨
4. ä»æ•°æ®åº“æŸ¥è¯¢æœ€æ–°æ•°æ®
5. å°†æœ€æ–°æ•°æ®å†™å…¥ç¼“å­˜
```

**ğŸ“ å®ç°ä»£ç **
```java
@Service
public class CacheAsideService {
    
    public void updateUser(User user) {
        String cacheKey = "user:" + user.getId();
        
        try {
            // æ­¥éª¤1ï¼šå…ˆåˆ é™¤ç¼“å­˜
            redisTemplate.delete(cacheKey);
            
            // æ­¥éª¤2ï¼šæ›´æ–°æ•°æ®åº“
            userMapper.updateById(user);
            
            log.info("ç”¨æˆ·æ›´æ–°æˆåŠŸï¼š{}", user.getId());
            
        } catch (Exception e) {
            log.error("ç”¨æˆ·æ›´æ–°å¤±è´¥", e);
            throw e;
        }
    }
    
    public User getUser(String userId) {
        String cacheKey = "user:" + userId;
        
        // å…ˆæŸ¥ç¼“å­˜
        User user = (User) redisTemplate.opsForValue().get(cacheKey);
        if (user != null) {
            return user; // ç¼“å­˜å‘½ä¸­
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
        user = userMapper.selectById(userId);
        if (user != null) {
            // å†™å›ç¼“å­˜
            redisTemplate.opsForValue().set(cacheKey, user, 1, TimeUnit.HOURS);
        }
        
        return user;
    }
}
```

### 5.3 å»¶è¿ŸåŒåˆ æ¨¡å¼è¯¦è§£


**ğŸ”¸ å»¶è¿ŸåŒåˆ çš„äº§ç”ŸèƒŒæ™¯**
å…ˆåˆ åå†™æ¨¡å¼åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´ï¼š

```
å¹¶å‘é—®é¢˜åœºæ™¯ï¼š
æ—¶é—´1ï¼šçº¿ç¨‹Aåˆ é™¤ç¼“å­˜
æ—¶é—´2ï¼šçº¿ç¨‹Bè¯»å–æ•°æ®ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼ˆæ—§æ•°æ®ï¼‰
æ—¶é—´3ï¼šçº¿ç¨‹Aæ›´æ–°æ•°æ®åº“ï¼ˆæ–°æ•°æ®ï¼‰
æ—¶é—´4ï¼šçº¿ç¨‹Bå°†æŸ¥åˆ°çš„æ—§æ•°æ®å†™å…¥ç¼“å­˜

ç»“æœï¼šç¼“å­˜ä¸­æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®åº“ä¸­æ˜¯æ–°æ•°æ®
```

**ğŸ”¸ å»¶è¿ŸåŒåˆ è§£å†³æ–¹æ¡ˆ**
åœ¨æ›´æ–°æ•°æ®åº“åï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´å†æ¬¡åˆ é™¤ç¼“å­˜ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼š

```java
@Service
public class DelayedDoubleDeleteService {
    
    @Autowired
    private ThreadPoolExecutor asyncExecutor;
    
    public void updateUser(User user) {
        String cacheKey = "user:" + user.getId();
        
        try {
            // ç¬¬ä¸€æ¬¡åˆ é™¤ï¼šåˆ é™¤ç¼“å­˜
            redisTemplate.delete(cacheKey);
            
            // æ›´æ–°æ•°æ®åº“
            userMapper.updateById(user);
            
            // å»¶è¿ŸåŒåˆ ï¼šå¼‚æ­¥å»¶è¿Ÿåˆ é™¤
            asyncExecutor.execute(() -> {
                try {
                    // å»¶è¿Ÿæ—¶é—´æ ¹æ®ä¸šåŠ¡åœºæ™¯è°ƒæ•´ï¼ˆä¸€èˆ¬100-500msï¼‰
                    Thread.sleep(300);
                    
                    // ç¬¬äºŒæ¬¡åˆ é™¤ï¼šç¡®ä¿ä¸€è‡´æ€§
                    redisTemplate.delete(cacheKey);
                    
                    log.info("å»¶è¿ŸåŒåˆ æ‰§è¡Œå®Œæˆï¼š{}", cacheKey);
                    
                } catch (Exception e) {
                    log.error("å»¶è¿ŸåŒåˆ å¤±è´¥", e);
                }
            });
            
        } catch (Exception e) {
            log.error("æ›´æ–°ç”¨æˆ·å¤±è´¥", e);
            throw e;
        }
    }
}
```

### 5.4 ç¼“å­˜æ›´æ–°æ¨¡å¼é€‰æ‹©æŒ‡å—


**ğŸ¯ é€‰æ‹©ç­–ç•¥**

```
ä¸šåŠ¡åœºæ™¯ â†’ æ¨èç­–ç•¥ï¼š

æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜ï¼ˆé‡‘èäº¤æ˜“ï¼‰ï¼š
âœ… åŒæ­¥åŒå†™ + åˆ†å¸ƒå¼äº‹åŠ¡
ç‰¹ç‚¹ï¼šå¼ºä¸€è‡´æ€§ï¼Œæ€§èƒ½è¾ƒä½

ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯ï¼ˆç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ï¼‰ï¼š
âœ… å…ˆåˆ åå†™æ¨¡å¼  
ç‰¹ç‚¹ï¼šç®€å•å¯é ï¼Œè½»å¾®ç¼“å­˜miss

é«˜å¹¶å‘è¯»å†™åœºæ™¯ï¼ˆçƒ­ç‚¹å•†å“ã€åº“å­˜ï¼‰ï¼š
âœ… å»¶è¿ŸåŒåˆ æ¨¡å¼
ç‰¹ç‚¹ï¼šå¤„ç†å¹¶å‘é—®é¢˜ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§

æ•°æ®å˜æ›´é¢‘ç‡ä½ï¼ˆé…ç½®ä¿¡æ¯ï¼‰ï¼š
âœ… å®šæ—¶åŒæ­¥
ç‰¹ç‚¹ï¼šç®€å•ï¼Œå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜

å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿï¼š
âœ… æ¶ˆæ¯é©±åŠ¨åŒæ­¥
ç‰¹ç‚¹ï¼šæ¾è€¦åˆï¼Œå¯æ‰©å±•æ€§å¥½
```

**ğŸ“Š æ¨¡å¼å¯¹æ¯”è¡¨**

| æ›´æ–°æ¨¡å¼ | **ä¸€è‡´æ€§ä¿è¯** | **æ€§èƒ½å½±å“** | **å®ç°å¤æ‚åº¦** | **æ¨èåœºæ™¯** |
|---------|--------------|-------------|--------------|-------------|
| ğŸ”„ **å…ˆåˆ åå†™** | `æœ€ç»ˆä¸€è‡´` | `è½»å¾®miss` | `ç®€å•` | `ä¸€èˆ¬ä¸šåŠ¡` |
| â° **å»¶è¿ŸåŒåˆ ** | `å¼ºä¸€è‡´` | `ä¸¤æ¬¡åˆ é™¤` | `ä¸­ç­‰` | `é«˜å¹¶å‘` |
| ğŸ“¨ **æ¶ˆæ¯åŒæ­¥** | `æœ€ç»ˆä¸€è‡´` | `é«˜æ€§èƒ½` | `å¤æ‚` | `åˆ†å¸ƒå¼ç³»ç»Ÿ` |
| ğŸ• **å®šæ—¶åŒæ­¥** | `å¼±ä¸€è‡´` | `æ‰¹é‡æ“ä½œ` | `ç®€å•` | `ä½å®æ—¶æ€§è¦æ±‚` |

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¤šçº§ç¼“å­˜ï¼šL1æœ¬åœ°ç¼“å­˜ + L2 Redisç¼“å­˜ï¼Œæå‡è®¿é—®æ€§èƒ½
ğŸ”¸ ç¼“å­˜é¢„çƒ­ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®ï¼Œé¿å…å†·å¯åŠ¨
ğŸ”¸ ç¼“å­˜é™çº§ï¼šæ•…éšœæ—¶ä¼˜é›…é™çº§ï¼Œä¿è¯ç³»ç»ŸåŸºæœ¬å¯ç”¨
ğŸ”¸ æ•°æ®åŒæ­¥ï¼šä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§
ğŸ”¸ è¯»å†™åˆ†ç¦»ï¼šä¸»åº“å¤„ç†å†™ï¼Œä»åº“å¤„ç†è¯»ï¼Œæå‡å¹¶å‘èƒ½åŠ›
ğŸ”¸ æ›´æ–°ç­–ç•¥ï¼šå…ˆåˆ åå†™ã€å»¶è¿ŸåŒåˆ ç­‰ç¼“å­˜æ›´æ–°æ¨¡å¼
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¤šçº§ç¼“å­˜çš„è®¾è®¡æ€æƒ³**
```
å°±è¿‘åŸåˆ™ï¼šæ•°æ®ç¦»ç”¨æˆ·è¶Šè¿‘è®¿é—®è¶Šå¿«
åˆ†å±‚å­˜å‚¨ï¼šæ ¹æ®è®¿é—®é¢‘ç‡åˆ†å±‚ç¼“å­˜
å®¹é‡å¹³è¡¡ï¼šä¸Šå±‚å®¹é‡å°ä½†å¿«ï¼Œä¸‹å±‚å®¹é‡å¤§ä½†æ…¢
å‘½ä¸­ä¼˜åŒ–ï¼šæé«˜L1å‘½ä¸­ç‡æ˜¯å…³é”®
```

**ğŸ”¹ æ•°æ®ä¸€è‡´æ€§çš„æƒè¡¡**
```
å¼ºä¸€è‡´æ€§ vs æ€§èƒ½ï¼š
â€¢ å¼ºä¸€è‡´æ€§ï¼šåŒæ­¥æ“ä½œï¼Œæ€§èƒ½è¾ƒä½
â€¢ æœ€ç»ˆä¸€è‡´æ€§ï¼šå¼‚æ­¥æ“ä½œï¼Œæ€§èƒ½è¾ƒé«˜
â€¢ ä¸šåŠ¡å†³ç­–ï¼šæ ¹æ®ä¸šåŠ¡é‡è¦æ€§é€‰æ‹©ç­–ç•¥

å®æ—¶æ€§ vs å¯é æ€§ï¼š
â€¢ å®æ—¶æ›´æ–°ï¼šå¯èƒ½å› æ•…éšœå¯¼è‡´ä¸ä¸€è‡´
â€¢ å»¶è¿Ÿæ›´æ–°ï¼šç‰ºç‰²å®æ—¶æ€§æ¢å–å¯é æ€§
```

**ğŸ”¹ è¯»å†™åˆ†ç¦»çš„æ”¶ç›Š**
```
æ€§èƒ½æå‡ï¼š
â€¢ è¯»æ“ä½œåˆ†æ•£åˆ°å¤šä¸ªä»åº“
â€¢ å†™æ“ä½œé›†ä¸­åœ¨ä¸»åº“ï¼Œé¿å…é”ç«äº‰
â€¢ æ•´ä½“å¹¶å‘èƒ½åŠ›æ˜¾è‘—æå‡

æ‰©å±•æ€§ï¼š
â€¢ å¯ä»¥æ ¹æ®è¯»è´Ÿè½½å¢åŠ ä»åº“
â€¢ è¯»å†™æ¯”ä¾‹é€šå¸¸ä¸º 80:20 æˆ– 90:10
â€¢ ä»åº“æ•°é‡å¯ä»¥çµæ´»æ‰©å±•
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ æ¶æ„è®¾è®¡å»ºè®®**
- **å°å‹åº”ç”¨**ï¼šå•Redis + å…ˆåˆ åå†™å³å¯
- **ä¸­å‹åº”ç”¨**ï¼šä¸»ä» + è¯»å†™åˆ†ç¦» + ç¼“å­˜é¢„çƒ­  
- **å¤§å‹åº”ç”¨**ï¼šå¤šçº§ç¼“å­˜ + æ¶ˆæ¯åŒæ­¥ + é™çº§ç­–ç•¥
- **è¶…å¤§å‹åº”ç”¨**ï¼šåˆ†ç‰‡é›†ç¾¤ + å¤šæœºæˆ¿ + å®Œæ•´é™çº§ä½“ç³»

**âš ï¸ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**
```
é—®é¢˜1ï¼šç¼“å­˜å‡»ç©¿ï¼ˆçƒ­ç‚¹keyå¤±æ•ˆï¼‰
è§£å†³ï¼šç¼“å­˜é¢„çƒ­ + äº’æ–¥é”é‡å»º

é—®é¢˜2ï¼šä¸»ä»å»¶è¿Ÿ
è§£å†³ï¼šè¯»å†™åˆ†ç¦» + å¼ºä¸€è‡´æ€§åœºæ™¯è¯»ä¸»åº“

é—®é¢˜3ï¼šç¼“å­˜é›ªå´©ï¼ˆå¤§é‡keyåŒæ—¶å¤±æ•ˆï¼‰  
è§£å†³ï¼šé”™å¼€è¿‡æœŸæ—¶é—´ + é™çº§ç­–ç•¥

é—®é¢˜4ï¼šæ•°æ®ä¸ä¸€è‡´
è§£å†³ï¼šå»¶è¿ŸåŒåˆ  + ç›‘æ§å‘Šè­¦
```

**ğŸš€ æ€§èƒ½è°ƒä¼˜æŠ€å·§**
- L1ç¼“å­˜å®¹é‡æ§åˆ¶åœ¨100MBä»¥å†…ï¼Œé¿å…GCå‹åŠ›
- Redisä¸»ä»å»¶è¿Ÿç›‘æ§ï¼Œè¶…è¿‡100mséœ€è¦ä¼˜åŒ–
- ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§ï¼ŒL1>85%ï¼ŒL2>95%ä¸ºåˆæ ¼
- å®šæœŸæ¸…ç†æ— æ•ˆç¼“å­˜ï¼Œé¿å…å†…å­˜æµªè´¹

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¤šçº§ç¼“å­˜æå‡æ€§èƒ½ï¼Œè¯»å†™åˆ†ç¦»æ‰©å±•å¹¶å‘
- é¢„çƒ­é™çº§ä¿ç¨³å®šï¼Œæ•°æ®åŒæ­¥ä¿ä¸€è‡´  
- å…ˆåˆ åå†™æ˜¯åŸºç¡€ï¼Œå»¶è¿ŸåŒåˆ é˜²å¹¶å‘
- æ¶æ„è®¾è®¡çœ‹è§„æ¨¡ï¼Œç›‘æ§ä¼˜åŒ–æ˜¯å…³é”®