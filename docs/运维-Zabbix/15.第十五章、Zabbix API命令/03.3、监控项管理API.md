---
title: 3、监控项管理API
---
## 📚 目录

1. [监控项基础概念](#1-监控项基础概念)
2. [监控项查询API详解](#2-监控项查询API详解)
3. [监控项创建与配置](#3-监控项创建与配置)
4. [监控项更新与管理](#4-监控项更新与管理)
5. [监控项类型与数值详解](#5-监控项类型与数值详解)
6. [高级功能与预处理](#6-高级功能与预处理)
7. [批量操作与实用技巧](#7-批量操作与实用技巧)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 监控项基础概念


### 1.1 什么是监控项？


> 💡 **通俗理解**  
> 监控项就像医院里的各种检查项目。医生要了解病人的健康状况，需要测量体温、血压、心率等指标。同样，Zabbix要了解服务器的运行状况，就需要监控CPU使用率、内存占用、磁盘空间等各种指标。每一个被监控的指标，就是一个"监控项"。

**🔍 监控项的本质**
```
现实生活类比：
体检项目 ────> Zabbix监控项
├─ 测体温    ────> CPU温度监控
├─ 量血压    ────> 网络带宽监控  
├─ 验血糖    ────> 内存使用率
└─ 心电图    ────> 服务状态检查

每个检查都有：
• 检查什么：监控的具体指标
• 多久检查：检查的时间间隔
• 正常范围：告警的阈值设定
• 检查结果：收集到的数据值
```

### 1.2 监控项的核心要素


**📋 监控项组成要素**
```
🎯 Key键值 (item.key)
  ├─ 作用：唯一标识这个监控项
  ├─ 类比：就像身份证号，每个人都不同
  └─ 示例：system.cpu.load[all,avg1] (CPU负载)

⏰ 检查间隔 (delay)  
  ├─ 作用：多长时间检查一次
  ├─ 类比：每天量一次体温 vs 每小时量一次
  └─ 示例：60s表示每分钟检查一次

📊 数值类型 (value_type)
  ├─ 作用：数据是数字、文本还是其他类型
  ├─ 类比：体温是数字(36.5°C)，性别是文本(男/女)
  └─ 示例：0=数字，1=字符，3=数字(无符号)

🏷️ 监控项类型 (type)
  ├─ 作用：数据从哪里来，怎么获取
  ├─ 类比：抽血化验 vs 问诊调查 vs 仪器检测
  └─ 示例：0=Zabbix agent，7=HTTP agent
```

---

## 2. 🔍 监控项查询API详解


### 2.1 item.get - 基础查询操作


**🎯 基本查询语法**
```json
{
    "jsonrpc": "2.0",
    "method": "item.get",
    "params": {
        "output": ["itemid", "name", "key_", "status", "delay"],
        "hostids": "10084"
    },
    "auth": "你的认证token",
    "id": 1
}
```

> 🧠 **记忆技巧**  
> **item.get**就像在医院查看病历，你可以指定查看哪个病人（hostids），查看哪些检查项目（output），这样就能获得需要的信息。

**📊 常用查询参数详解**

| 参数名 | **作用说明** | **生活类比** | **使用示例** |
|--------|-------------|-------------|-------------|
| `hostids` | 指定要查询的主机 | 选择要体检的病人 | `"hostids": "10084"` |
| `groupids` | 按主机组查询 | 选择某个科室的病人 | `"groupids": "2"` |
| `itemids` | 查询特定监控项 | 查看特定的检查项目 | `"itemids": ["1001", "1002"]` |
| `output` | 返回哪些字段 | 要看病历的哪些内容 | `"output": "extend"` |
| `search` | 搜索条件 | 按症状搜索病历 | `"search": {"name": "CPU"}` |

### 2.2 精确查询实例


**🔸 查询CPU相关监控项**
```json
{
    "jsonrpc": "2.0",
    "method": "item.get",
    "params": {
        "output": ["itemid", "name", "key_", "delay", "status"],
        "hostids": "10084",
        "search": {
            "name": "CPU"
        },
        "searchWildcardsEnabled": true
    },
    "auth": "认证token",
    "id": 1
}
```

**🔸 查询有问题的监控项**
```json
{
    "jsonrpc": "2.0", 
    "method": "item.get",
    "params": {
        "output": "extend",
        "filter": {
            "status": "1"
        },
        "selectHosts": ["hostid", "name"]
    },
    "auth": "认证token",
    "id": 1
}
```

> 💡 **实用提示**  
> `status: "1"` 表示禁用的监控项，`status: "0"` 表示启用的监控项。就像医院里有些检查项目暂停服务一样。

---

## 3. ⚙️ 监控项创建与配置


### 3.1 item.create - 创建新监控项


**🎯 创建监控项的基本思路**
```
第一步：确定要监控什么 (name和key_)
第二步：确定怎么获取数据 (type)  
第三步：确定数据格式 (value_type)
第四步：设置检查频率 (delay)
第五步：配置存储策略 (history, trends)
```

**🔸 创建CPU使用率监控项**
```json
{
    "jsonrpc": "2.0",
    "method": "item.create", 
    "params": {
        "name": "CPU使用率",
        "key_": "system.cpu.util[,user,avg1]",
        "hostid": "10084",
        "type": 0,
        "value_type": 0,
        "delay": "60s",
        "history": "90d",
        "trends": "365d",
        "units": "%",
        "description": "监控CPU用户态使用率"
    },
    "auth": "认证token",
    "id": 1
}
```

### 3.2 关键参数详细说明


**📋 必填参数解释**
```
🎯 name (监控项名称)
  ├─ 作用：给这个监控项起个容易理解的名字
  ├─ 类比：给体检项目起名字，比如"血压检查"
  └─ 要求：简洁明了，一看就知道监控什么

🔑 key_ (监控项键值)  
  ├─ 作用：技术层面的唯一标识符
  ├─ 类比：医院的检查项目编号，如"XY001"
  └─ 要求：必须唯一，不能重复

🏠 hostid (所属主机)
  ├─ 作用：这个监控项属于哪台服务器
  ├─ 类比：这个检查是给哪个病人做的
  └─ 要求：必须是存在的主机ID

🔧 type (监控项类型)
  ├─ 作用：决定数据从哪里来，怎么获取
  ├─ 类比：抽血、拍片、问诊等不同检查方式
  └─ 常用：0=Zabbix agent, 7=HTTP agent
```

### 3.3 监控项类型选择指南


**📊 主要监控项类型对比**

| 类型值 | **类型名称** | **适用场景** | **获取方式** | **生活类比** |
|--------|-------------|-------------|-------------|-------------|
| `0` | **Zabbix agent** | `系统指标监控` | `Agent主动上报` | `病人主动报告症状` |
| `7` | **HTTP agent** | `Web服务监控` | `HTTP请求获取` | `医生打电话询问` |
| `2` | **Trapper** | `自定义数据推送` | `外部程序推送` | `家属提供信息` |
| `3` | **Simple check** | `网络连通性` | `Zabbix服务器检查` | `医生直接观察` |
| `10` | **External check** | `自定义脚本` | `执行外部脚本` | `专家会诊` |

> 🧠 **选择原则**  
> • **系统资源监控** → 选择Zabbix agent (type=0)  
> • **网站可用性监控** → 选择HTTP agent (type=7)  
> • **应用程序自定义数据** → 选择Trapper (type=2)

---

## 4. 🔄 监控项更新与管理


### 4.1 item.update - 修改监控项配置


**🎯 更新操作的核心思路**
```
更新监控项就像调整体检方案：
├─ 检查频率调整：从每天一次改为每小时一次
├─ 检查项目修改：增加新的检查指标  
├─ 阈值标准调整：修改正常值范围
└─ 启用状态改变：暂停或恢复某些检查
```

**🔸 修改监控项检查间隔**
```json
{
    "jsonrpc": "2.0",
    "method": "item.update",
    "params": {
        "itemid": "12345",
        "delay": "30s"
    },
    "auth": "认证token", 
    "id": 1
}
```

**🔸 批量启用/禁用监控项**
```json
{
    "jsonrpc": "2.0",
    "method": "item.update", 
    "params": [
        {
            "itemid": "12345",
            "status": "0"
        },
        {
            "itemid": "12346", 
            "status": "0"
        }
    ],
    "auth": "认证token",
    "id": 1
}
```

> 💡 **状态码说明**  
> • `status: "0"` = 启用监控项（正常工作）  
> • `status: "1"` = 禁用监控项（暂停监控）

### 4.2 item.delete - 删除监控项


**⚠️ 删除前的注意事项**
```
删除监控项就像取消体检项目：
✅ 确认：真的不需要这个监控了吗？
✅ 备份：历史数据是否需要保留？
✅ 关联：有没有依赖这个监控项的触发器？
✅ 影响：删除后对整体监控方案的影响？
```

**🔸 删除单个监控项**
```json
{
    "jsonrpc": "2.0",
    "method": "item.delete",
    "params": ["12345"],
    "auth": "认证token",
    "id": 1
}
```

**🔸 删除多个监控项**
```json
{
    "jsonrpc": "2.0",
    "method": "item.delete", 
    "params": ["12345", "12346", "12347"],
    "auth": "认证token",
    "id": 1
}
```

---

## 5. 📊 监控项类型与数值详解


### 5.1 value_type - 数值类型深度解析


**🔍 数值类型的重要性**
```
选择正确的数值类型就像选择合适的测量工具：
├─ 测体温用温度计 → 数字类型，保留小数
├─ 问性别用问卷 → 文本类型，男/女
├─ 查病史用记录 → 日志类型，详细描述
└─ 计脉搏用计数 → 整数类型，不要小数
```

**📋 数值类型详细对比**

| 值 | **类型名称** | **存储内容** | **适用场景** | **示例数据** |
|---|-------------|-------------|-------------|-------------|
| `0` | **数字(浮点)** | `小数数字` | `CPU使用率、温度` | `85.6`, `36.7` |
| `1` | **字符串** | `文本内容` | `服务状态、版本号` | `"Running"`, `"v2.1"` |
| `2` | **日志** | `日志信息` | `错误日志、事件记录` | `"Error: timeout"` |
| `3` | **数字(无符号)** | `正整数` | `连接数、进程数` | `256`, `1024` |
| `4` | **文本** | `长文本` | `配置文件、详细信息` | `大段文本内容` |

### 5.2 delay - 检查间隔策略


**⏰ 检查间隔的设置原则**
```
🎯 设置检查间隔就像安排体检频率：

急诊指标 (1-10秒)：
├─ 服务可用性检查
├─ 关键进程状态  
└─ 网络连通性

常规指标 (30-60秒)：
├─ CPU使用率
├─ 内存占用率
└─ 磁盘使用率

长期指标 (5-30分钟)：
├─ 磁盘容量
├─ 系统版本信息
└─ 硬件信息
```

**🔸 不同间隔的语法格式**
```json
{
    "delay": "30s",     // 每30秒检查一次
    "delay": "5m",      // 每5分钟检查一次  
    "delay": "1h",      // 每1小时检查一次
    "delay": "1d",      // 每1天检查一次
    "delay": "300",     // 300秒(数字格式)
}
```

### 5.3 history与trends - 数据保留策略


**💾 数据存储的两层架构**
```
Zabbix数据存储就像医院的病历管理：

🗂️ 详细病历 (history)
  ├─ 保存内容：每次检查的原始数据
  ├─ 保存时间：通常90天内的所有数据
  ├─ 查看精度：可以看到每分钟的具体数值
  └─ 存储成本：占用空间大，查询较慢

📊 汇总报告 (trends)  
  ├─ 保存内容：每小时的统计数据(最大值、最小值、平均值)
  ├─ 保存时间：通常1-5年的汇总数据
  ├─ 查看精度：只能看到每小时的统计情况
  └─ 存储成本：占用空间小，查询较快
```

**📋 推荐的保留策略**

| 监控项类型 | **History保留** | **Trends保留** | **原因说明** |
|-----------|----------------|---------------|-------------|
| **关键指标** | `90d` | `5y` | `需要详细的历史分析` |
| **常规指标** | `30d` | `2y` | `平衡存储与性能` |
| **日志信息** | `7d` | `0` | `日志不需要trends` |
| **一次性检查** | `1d` | `0` | `数据价值有限` |

---

## 6. 🚀 高级功能与预处理


### 6.1 preprocessing - 数据预处理规则


**🎯 预处理的作用原理**
```
数据预处理就像医院的检验科处理样本：

原始样本 ──处理──> 标准化结果 ──报告──> 医生诊断
    ↓              ↓              ↓
  原始数据    预处理规则      最终监控值

预处理能做什么：
├─ 单位转换：字节→MB，秒→分钟
├─ 数值计算：求差值、计算百分比  
├─ 文本提取：从复杂字符串中提取关键信息
└─ 数据验证：检查数据是否在合理范围内
```

**🔸 常用预处理规则示例**
```json
{
    "name": "磁盘使用率",
    "key_": "vfs.fs.size[/,used]", 
    "preprocessing": [
        {
            "type": "5",  // 正则表达式提取
            "params": "([0-9]+)",
            "error_handler": "0"
        },
        {
            "type": "1",  // 乘法运算
            "params": "0.000001",  // 转换为MB
            "error_handler": "0"
        }
    ]
}
```

### 6.2 master_itemid - 主监控项依赖


**🔗 监控项依赖关系**
```
主监控项关系就像医院的复合检查：

主检查：血液采样 (一次取血)
  ├─ 子检查1：血糖检测
  ├─ 子检查2：血脂检测  
  ├─ 子检查3：肝功能检测
  └─ 子检查4：肾功能检测

优势：
✅ 减少检查次数：一次取血，多项检测
✅ 提高效率：避免重复的数据采集
✅ 节约资源：减少网络请求和系统负载
```

**🔸 创建依赖监控项**
```json
{
    "name": "JSON响应时间",
    "key_": "web.response.time", 
    "type": "18",  // 依赖型监控项
    "master_itemid": "12345",  // 主监控项ID
    "preprocessing": [
        {
            "type": "12",  // JSONPath提取
            "params": "$.response_time"
        }
    ]
}
```

### 6.3 units与formula - 单位与计算


**📊 单位设置的重要性**
```
正确的单位设置就像给化验单标注单位：
├─ 体温：36.5°C (不是36.5)
├─ 血压：120mmHg (不是120)  
├─ 血糖：5.6mmol/L (不是5.6)
└─ 脉搏：72次/分 (不是72)

Zabbix中的单位：
├─ 百分比：%
├─ 字节：B, KB, MB, GB
├─ 时间：s, ms, us  
├─ 网络：bps, Bps
└─ 自定义：次/秒, 个/分钟
```

**🔸 计算公式应用**
```json
{
    "name": "内存使用率",
    "formula": "last(//vm.memory.used) / last(//vm.memory.total) * 100",
    "units": "%",
    "value_type": "0"
}
```

---

## 7. 🔧 批量操作与实用技巧


### 7.1 监控项批量管理


**🎯 批量操作的应用场景**
```
批量操作就像医院批量体检：
├─ 批量创建：为新入职员工统一安排体检项目
├─ 批量修改：调整某类检查的频率或标准
├─ 批量查询：查看所有异常指标  
└─ 批量删除：取消过时的检查项目
```

**🔸 批量创建监控项模板**
```json
{
    "jsonrpc": "2.0",
    "method": "item.create",
    "params": [
        {
            "name": "CPU使用率",
            "key_": "system.cpu.util",
            "hostid": "10084",
            "type": 0,
            "value_type": 0,
            "delay": "60s"
        },
        {
            "name": "内存使用率", 
            "key_": "vm.memory.util",
            "hostid": "10084",
            "type": 0,
            "value_type": 0,
            "delay": "60s"
        }
    ],
    "auth": "认证token",
    "id": 1
}
```

### 7.2 实用查询技巧


**🔍 高效查询的方法**
```json
// 查询所有有问题的监控项
{
    "method": "item.get",
    "params": {
        "output": ["itemid", "name", "lastvalue", "error"],
        "filter": {
            "status": "0"  // 只看启用的
        },
        "search": {
            "error": ".*"  // 有错误信息的
        },
        "searchWildcardsEnabled": true,
        "selectHosts": ["name"]
    }
}
```

**🔸 性能监控专用查询**
```json
// 查询高频率检查的监控项
{
    "method": "item.get", 
    "params": {
        "output": ["name", "key_", "delay", "hostid"],
        "filter": {
            "delay": ["1s", "5s", "10s"]
        },
        "selectHosts": ["name"],
        "sortfield": "delay"
    }
}
```

### 7.3 监控项优化建议


**⚡ 性能优化策略**
```
🎯 优化原则：

检查频率优化：
✅ 关键指标：1-30秒间隔
✅ 常规指标：1-5分钟间隔  
✅ 静态信息：30分钟以上间隔
❌ 避免：所有监控项都用相同间隔

数据保留优化：
✅ 重要数据：history 90天，trends 5年
✅ 一般数据：history 30天，trends 2年
✅ 临时数据：history 7天，trends 不保留
❌ 避免：所有数据都长期保留

监控项数量控制：
✅ 每台主机：50-200个监控项为宜
✅ 定期清理：删除不再需要的监控项
✅ 合理分组：相关监控项放在同一模板
❌ 避免：盲目增加监控项数量
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本操作


```
🔸 item.get：查询监控项，掌握各种过滤和搜索条件
🔸 item.create：创建监控项，理解各个参数的含义和作用  
🔸 item.update：修改监控项，学会批量操作提高效率
🔸 item.delete：删除监控项，注意删除前的检查和确认
🔸 参数配置：key_、type、value_type、delay等核心参数
```

### 8.2 关键理解要点


**🔹 监控项的本质理解**
```
监控项 = 数据采集点
├─ Key：决定采集什么数据
├─ Type：决定如何采集数据
├─ Delay：决定多久采集一次  
└─ Value_type：决定数据的格式
```

**🔹 数据类型选择原则**
```
数字类型：用于需要计算、比较、告警的指标
文本类型：用于状态描述、版本信息等
日志类型：用于错误信息、事件记录
选择原则：根据数据的实际用途来决定
```

**🔹 性能与存储平衡**
```
高频率检查 ↔ 系统性能影响
长期数据保留 ↔ 存储空间占用
监控项数量 ↔ 管理复杂度
详细程度 ↔ 查询效率
```

### 8.3 实际应用指导


**🎯 新手上路建议**
```
第一步：从基础监控项开始
├─ CPU、内存、磁盘使用率
├─ 网络连通性检查
└─ 基础服务状态监控

第二步：逐步添加业务监控
├─ 应用程序性能指标
├─ 业务流程关键节点
└─ 用户体验相关指标

第三步：建立监控项模板
├─ 标准化常用监控项
├─ 批量应用到多台主机
└─ 持续优化和改进
```

**🧠 记忆口诀**
- **item.get查监控，过滤搜索条件通**
- **item.create建新项，参数配置要精通**  
- **type决定采集法，value_type定格式**
- **delay控制检查频，history trends存数据**
- **批量操作提效率，模板标准化管理**

### 8.4 常见问题解决


**❓ 监控项创建失败**
```
检查清单：
☑ key_是否唯一，没有重复
☑ hostid是否存在且正确
☑ type类型是否支持该key_
☑ value_type是否与数据匹配
☑ 语法格式是否正确
```

**❓ 监控项无数据**
```
排查步骤：
1. 检查监控项状态是否启用
2. 确认主机agent是否正常
3. 验证key_是否支持
4. 查看error字段的错误信息
5. 测试网络连通性
```

**💡 最佳实践建议**
- **命名规范**：使用清晰、统一的命名规则
- **分类管理**：将相关监控项归类到模板中
- **文档记录**：在description中记录监控项的用途
- **定期维护**：清理无用的监控项，优化性能
- **测试验证**：新建监控项后及时验证数据采集

**核心理念**：监控项是Zabbix的基础，就像医院的各种检查项目。掌握好监控项的管理，就掌握了Zabbix监控的核心能力。记住：**简单实用、循序渐进、持续优化**。