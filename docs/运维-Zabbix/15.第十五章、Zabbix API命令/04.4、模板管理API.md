---
title: 4、模板管理API
---
## 📚 目录

1. [模板基础概念](#1-模板基础概念)
2. [模板查询操作](#2-模板查询操作)
3. [模板创建与配置](#3-模板创建与配置)
4. [模板更新与维护](#4-模板更新与维护)
5. [模板关联与批量操作](#5-模板关联与批量操作)
6. [模板继承与版本管理](#6-模板继承与版本管理)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🎯 模板基础概念


### 1.1 什么是Zabbix模板


> **💡 简单理解**：模板就像是监控的"配方"或"蓝图"
> 
> 比如说，你要监控100台Linux服务器，不可能一台一台去配置CPU、内存、磁盘等监控项。模板就是把这些通用的监控配置打包成一个"套餐"，一次配置，到处使用。

**🔸 核心定义**
```
模板（Template）：预定义的监控配置集合
包含内容：监控项、触发器、图形、屏幕等
使用方式：关联到主机，自动应用所有配置
优势：标准化、复用性、维护简单
```

### 1.2 模板的组成结构


```
模板结构图：
┌─────────────────┐
│     模板       │
├─────────────────┤
│ • 监控项(Items) │ ← 具体要监控什么数据
│ • 触发器(Triggers)│ ← 什么情况下报警  
│ • 图形(Graphs)   │ ← 数据如何展示
│ • 应用集(Applications)│ ← 分组管理
│ • 屏幕(Screens)  │ ← 仪表盘展示
│ • 宏定义(Macros) │ ← 参数变量
└─────────────────┘
```

**📋 实际例子**
```
Linux基础监控模板包含：
✓ CPU使用率监控项
✓ 内存使用率监控项  
✓ 磁盘空间监控项
✓ CPU使用率>80%触发器
✓ 内存使用率>90%触发器
✓ 系统性能图形
```

### 1.3 模板的应用场景


**🎯 典型使用场景**
```
服务器监控：
• Linux服务器模板
• Windows服务器模板
• 数据库服务器模板

应用监控：
• Web应用模板
• 数据库应用模板
• 中间件应用模板

网络设备：
• 交换机模板
• 路由器模板
• 防火墙模板
```

---

## 2. 🔍 模板查询操作


### 2.1 基础查询方法


**template.get - 查询模板信息**

> **💭 生活类比**：就像在图书馆查书目录，你可以按书名、作者、分类等方式查找

```json
{
    "jsonrpc": "2.0",
    "method": "template.get",
    "params": {
        "output": ["templateid", "name", "host"]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

**📊 查询参数说明**
| 参数 | 含义 | 示例值 |
|------|------|--------|
| `output` | 返回哪些字段 | `["name", "host"]` |
| `templateids` | 指定模板ID | `["10001", "10002"]` |
| `groupids` | 按模板组查询 | `["4", "5"]` |
| `search` | 模糊搜索 | `{"name": "Linux"}` |

### 2.2 常用查询示例


**🔸 查询所有模板基本信息**
```json
{
    "jsonrpc": "2.0",
    "method": "template.get", 
    "params": {
        "output": ["templateid", "name", "host"],
        "sortfield": "name"
    },
    "auth": "your-auth-token",
    "id": 1
}
```

**🔸 查询包含关联主机的模板**
```json
{
    "jsonrpc": "2.0",
    "method": "template.get",
    "params": {
        "output": "extend",
        "selectHosts": ["hostid", "name"],
        "selectGroups": ["name"]
    },
    "auth": "your-auth-token", 
    "id": 1
}
```

**🔸 按名称模糊搜索模板**
```json
{
    "jsonrpc": "2.0",
    "method": "template.get",
    "params": {
        "output": ["templateid", "name"],
        "search": {
            "name": "Linux"
        },
        "searchWildcardsEnabled": true
    },
    "auth": "your-auth-token",
    "id": 1
}
```

### 2.3 查询模板详细配置


**🔸 查询模板包含的监控项**
```json
{
    "jsonrpc": "2.0", 
    "method": "template.get",
    "params": {
        "templateids": ["10001"],
        "selectItems": ["itemid", "name", "key_", "type"],
        "output": ["name"]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

---

## 3. 🛠️ 模板创建与配置


### 3.1 创建基础模板


**template.create - 创建新模板**

> **💡 理解要点**：创建模板就像建立一个空的"监控方案"，之后可以往里面添加具体的监控项和规则

```json
{
    "jsonrpc": "2.0",
    "method": "template.create",
    "params": {
        "host": "Template_Custom_Web",
        "name": "自定义Web服务监控模板",
        "groups": [
            {"groupid": "1"}
        ],
        "description": "用于监控Web服务的自定义模板"
    },
    "auth": "your-auth-token",
    "id": 1
}
```

**📋 创建参数详解**
```
必需参数：
• host: 模板的技术名称（唯一标识）
• groups: 模板所属组（至少一个）

可选参数：
• name: 显示名称（用户友好）
• description: 模板描述
• macros: 宏定义
```

### 3.2 创建完整模板示例


**🔸 创建包含监控项的Web服务模板**
```json
{
    "jsonrpc": "2.0",
    "method": "template.create", 
    "params": {
        "host": "Template_Web_Service",
        "name": "Web服务监控模板",
        "groups": [{"groupid": "1"}],
        "macros": [
            {
                "macro": "{$WEB_PORT}",
                "value": "80"
            },
            {
                "macro": "{$WEB_TIMEOUT}",
                "value": "30"
            }
        ],
        "items": [
            {
                "name": "HTTP服务状态检查",
                "key_": "net.tcp.service[http,{HOST.IP},{$WEB_PORT}]",
                "type": 3,
                "value_type": 3,
                "delay": "60s"
            }
        ]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

### 3.3 模板组管理


**🔸 模板组的作用**
```
组织作用：
• 分类管理不同类型的模板
• 权限控制的基础单位
• 批量操作的便利

常见分组：
• Templates/Operating systems
• Templates/Applications  
• Templates/Databases
• Templates/Network devices
```

---

## 4. 🔄 模板更新与维护


### 4.1 更新模板基本信息


**template.update - 更新模板**

> **💭 类比理解**：就像修改文档，你可以改标题、改内容，也可以添加新章节

```json
{
    "jsonrpc": "2.0",
    "method": "template.update",
    "params": {
        "templateid": "10001",
        "name": "Linux服务器监控模板-升级版",
        "description": "增强版Linux监控，包含更多性能指标"
    },
    "auth": "your-auth-token",
    "id": 1
}
```

### 4.2 批量更新模板


**template.massupdate - 批量更新**
```json
{
    "jsonrpc": "2.0",
    "method": "template.massupdate",
    "params": {
        "templates": [
            {"templateid": "10001"},
            {"templateid": "10002"}
        ],
        "groups": [
            {"groupid": "4"}
        ]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

### 4.3 删除模板


**template.delete - 删除模板**

> **⚠️ 重要提醒**：删除模板会影响所有使用该模板的主机，务必谨慎操作

```json
{
    "jsonrpc": "2.0",
    "method": "template.delete",
    "params": ["10001", "10002"],
    "auth": "your-auth-token", 
    "id": 1
}
```

---

## 5. 🔗 模板关联与批量操作


### 5.1 主机与模板关联


**🔸 关联模板到主机**

> **💡 简单理解**：就像给手机安装应用，一个模板可以"安装"到多个主机上

```json
{
    "jsonrpc": "2.0",
    "method": "host.update",
    "params": {
        "hostid": "10084",
        "templates": [
            {"templateid": "10001"}
        ]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

### 5.2 批量关联操作


**template.massadd - 批量添加关联**
```json
{
    "jsonrpc": "2.0",
    "method": "template.massadd",
    "params": {
        "templates": [
            {"templateid": "10001"}
        ],
        "hosts": [
            {"hostid": "10084"},
            {"hostid": "10085"}
        ]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

**template.massremove - 批量移除关联**
```json
{
    "jsonrpc": "2.0", 
    "method": "template.massremove",
    "params": {
        "templateids": ["10001"],
        "hostids": ["10084", "10085"]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

### 5.3 查询模板关联关系


**🔸 查看模板关联了哪些主机**
```json
{
    "jsonrpc": "2.0",
    "method": "template.get", 
    "params": {
        "templateids": ["10001"],
        "selectHosts": ["hostid", "name", "status"],
        "output": ["name"]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

**🔸 查看主机使用了哪些模板**
```json
{
    "jsonrpc": "2.0",
    "method": "host.get",
    "params": {
        "hostids": ["10084"],
        "selectParentTemplates": ["templateid", "name"],
        "output": ["name"]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

---

## 6. 🏗️ 模板继承与版本管理


### 6.1 模板继承关系


**🔸 什么是模板继承**

> **💭 生活类比**：就像家族遗传，子模板会"继承"父模板的所有监控配置，还可以添加自己独有的配置

```
继承关系示例：
┌─────────────────┐
│   Linux基础模板  │ ← 父模板（CPU、内存、磁盘）
└─────────────────┘
         ↓ 继承
┌─────────────────┐  
│   Web服务器模板  │ ← 子模板（继承基础+Apache监控）
└─────────────────┘
         ↓ 继承  
┌─────────────────┐
│   电商Web模板    │ ← 孙模板（继承Web+业务指标）
└─────────────────┘
```

**🔸 创建继承模板**
```json
{
    "jsonrpc": "2.0",
    "method": "template.create",
    "params": {
        "host": "Template_Web_Enhanced", 
        "name": "增强Web服务模板",
        "groups": [{"groupid": "1"}],
        "templates": [
            {"templateid": "10001"}
        ]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

### 6.2 模板链接管理


**🔸 添加父模板链接**
```json
{
    "jsonrpc": "2.0",
    "method": "template.update",
    "params": {
        "templateid": "10050",
        "templates": [
            {"templateid": "10001"},
            {"templateid": "10002"}  
        ]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

**🔸 查询模板继承关系**
```json
{
    "jsonrpc": "2.0",
    "method": "template.get",
    "params": {
        "templateids": ["10050"],
        "selectParentTemplates": ["templateid", "name"],
        "selectTemplates": ["templateid", "name"],
        "output": ["name"]
    },
    "auth": "your-auth-token",
    "id": 1
}
```

### 6.3 模板导入导出


**🔸 导出模板配置**

> **💡 实用技巧**：导出模板就像备份，可以在不同Zabbix环境间迁移配置

```json
{
    "jsonrpc": "2.0",
    "method": "configuration.export",
    "params": {
        "format": "xml",
        "options": {
            "templates": ["10001"]
        }
    },
    "auth": "your-auth-token",
    "id": 1
}
```

**🔸 导入模板配置**
```json
{
    "jsonrpc": "2.0", 
    "method": "configuration.import",
    "params": {
        "format": "xml",
        "source": "导出的XML内容",
        "rules": {
            "templates": {
                "createMissing": true,
                "updateExisting": true
            }
        }
    },
    "auth": "your-auth-token",
    "id": 1
}
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 模板本质：可复用的监控配置集合
🔸 基础操作：查询、创建、更新、删除
🔸 关联管理：模板与主机的绑定关系
🔸 批量操作：提高管理效率的重要手段
🔸 继承机制：模板间的父子关系
🔸 导入导出：配置迁移和备份的基础
```

### 7.2 实际应用场景总结


**🎯 日常管理任务**
```
模板标准化：
• 为不同类型服务器创建标准模板
• 统一监控指标和报警规则
• 简化新主机部署流程

批量操作：
• 批量关联模板到多台主机
• 批量更新模板配置
• 批量移除过时的模板

版本管理：
• 模板配置的版本控制
• 测试环境与生产环境的配置同步
• 模板的备份与恢复
```

### 7.3 最佳实践建议


**📌 命名规范**
```
模板命名建议：
• Template_OS_Linux_Base（操作系统基础）
• Template_App_Apache_Web（应用服务）
• Template_DB_MySQL_Performance（数据库性能）

清晰的命名有助于：
✓ 快速识别模板用途
✓ 便于搜索和管理
✓ 避免重复创建
```

**📌 组织架构**
```
模板分层建议：
基础层：操作系统基础监控
应用层：具体应用服务监控  
业务层：业务相关指标监控

继承关系：
基础 → 应用 → 业务（逐层继承）
```

**📌 维护策略**
```
定期维护：
• 定期检查模板使用情况
• 清理不再使用的模板
• 更新过时的监控项和触发器

版本控制：
• 重要变更前先导出备份
• 在测试环境验证后再应用到生产
• 记录模板变更历史
```

### 7.4 常见问题与解决


**🔧 问题排查指南**
```
模板关联失败：
→ 检查主机状态是否正常
→ 确认模板中的监控项是否适用
→ 验证宏定义是否正确

监控数据异常：
→ 检查模板继承关系
→ 确认监控项配置
→ 验证触发器逻辑

性能问题：
→ 避免过于复杂的继承关系
→ 合理设置监控频率
→ 定期清理无用的历史数据
```

**核心记忆口诀**：
- 模板就是监控的"配方"，一次配置到处使用
- 查询、创建、更新、删除是基础四大操作
- 批量操作提效率，继承关系减重复
- 导入导出做备份，规范命名好管理

**🎯 学习建议**：从简单的模板创建开始，逐步掌握复杂的继承关系和批量操作，在实际项目中多练习才能熟练掌握。