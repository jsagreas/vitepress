---
title: 3、主动被动-监控模式
---
## 📚 目录

1. [监控模式基础概念](#1-监控模式基础概念)
2. [被动检查模式详解](#2-被动检查模式详解)
3. [主动检查模式详解](#3-主动检查模式详解)
4. [两种模式深度对比](#4-两种模式深度对比)
5. [混合模式应用策略](#5-混合模式应用策略)
6. [实际选择指导](#6-实际选择指导)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🎯 监控模式基础概念


### 1.1 什么是监控模式


想象一下日常生活中的两种情况：

🌰 **生活类比**：
- **被动模式**：就像老师定期检查学生作业，老师主动去问"作业做完了吗？"
- **主动模式**：就像学生主动汇报学习进度，学生说"老师，我今天学了什么"

在Zabbix监控系统中，也有类似的两种工作方式：

**🔸 被动检查（Passive Check）**
```
Zabbix Server ──主动询问──▶ Agent ──返回数据──▶ Zabbix Server
     (老师)                    (学生)              (收到答案)
```

**🔸 主动检查（Active Check）**
```
Agent ──主动发送──▶ Zabbix Server ──接收数据──▶ 存储处理
  (学生)              (老师)              (记录成绩)
```

### 1.2 为什么需要两种模式


**🤔 实际需求场景**：

**场景一：小公司监控**
- 服务器数量少（10台以内）
- 网络环境简单稳定
- 管理员希望严格控制监控节奏
- **适合**：被动检查模式

**场景二：大型企业监控**
- 服务器数量多（数百台）
- 分布在不同网络环境
- 需要高效的数据传输
- **适合**：主动检查模式

### 1.3 核心区别概览


| 对比维度 | **被动检查** | **主动检查** | **通俗理解** |
|---------|------------|-------------|-------------|
| 🎭 **发起方** | `Zabbix Server` | `Zabbix Agent` | `谁先开口说话` |
| 🌐 **网络连接** | `Server连接Agent` | `Agent连接Server` | `谁主动拨打电话` |
| ⚡ **性能负载** | `Server压力大` | `Agent分担压力` | `谁比较累` |
| 🔧 **配置复杂度** | `相对简单` | `需要更多配置` | `哪个更好设置` |

---

## 2. 📡 被动检查模式详解


### 2.1 被动检查工作原理


**🔸 详细工作流程**

想象Zabbix Server是一个**勤劳的管理员**，需要定期检查每台服务器的状态：

```
时间轴示例：每30秒检查一次CPU使用率

09:00:00  Server对Agent1说："告诉我CPU使用率"
09:00:01  Agent1回答："CPU使用率是85%"
09:00:02  Server记录：Agent1-CPU-85%

09:00:30  Server对Agent1说："告诉我CPU使用率" 
09:00:31  Agent1回答："CPU使用率是90%"
09:00:32  Server记录：Agent1-CPU-90%
```

**🔸 技术实现机制**

```
Zabbix Server工作步骤：
1️⃣ 查看监控项配置（需要监控什么）
2️⃣ 确定检查时间（什么时候检查）  
3️⃣ 主动连接Agent（拨通电话）
4️⃣ 发送检查请求（问具体问题）
5️⃣ 接收Agent响应（听到答案）
6️⃣ 存储监控数据（记录结果）
```

### 2.2 被动模式的网络通信


**🔸 网络连接方向**

```
网络拓扑图：
     
┌─────────────────┐         ┌─────────────────┐
│  Zabbix Server  │ ──────▶ │  Zabbix Agent   │
│   (监控中心)     │  发起连接  │   (被监控端)     │
│   IP: 10.1.1.100│         │   IP: 10.1.1.101│
│   Port: 随机     │◀────── │   Port: 10050   │
└─────────────────┘  返回数据  └─────────────────┘
```

**🔸 防火墙配置要求**

```
网络安全配置：

Zabbix Server端：
✅ 出站规则：允许连接到Agent的10050端口
❌ 入站规则：不需要特殊配置

Zabbix Agent端：  
❌ 出站规则：不需要特殊配置
✅ 入站规则：允许Server连接10050端口

防火墙开放命令示例：
# Agent端执行

firewall-cmd --add-port=10050/tcp --permanent
firewall-cmd --reload
```

### 2.3 被动模式的优势与劣势


**🟢 被动模式优势**

**🔸 配置简单直观**
- 监控项配置在Server端，集中管理
- Agent端无需复杂配置，开箱即用
- 新手容易理解和上手

**🔸 严格控制监控节奏**
- Server完全控制检查频率
- 可以精确控制网络流量
- 避免Agent"乱发"数据

**🔸 实时性较好**
- Server想要数据时立即获取
- 不依赖Agent的主动性
- 监控时间点可预测

**🔴 被动模式劣势**

**🔸 Server性能瓶颈**
```
性能影响分析：

100台服务器 × 20个监控项 × 每分钟检查 = 2000次/分钟请求
每次请求：建立连接 → 发送请求 → 等待响应 → 关闭连接

Server负载：
CPU: 处理大量网络连接请求
内存: 维护连接状态信息  
网络: 发起所有监控连接
```

**🔸 网络开销较大**
- 每次检查都需要建立TCP连接
- 大量短连接消耗网络资源
- 在服务器数量多时问题突出

**🔸 扩展性限制**
- Server处理能力有上限
- 监控规模受到Server性能约束
- 难以支持大规模监控场景

---

## 3. 🚀 主动检查模式详解


### 3.1 主动检查工作原理


**🔸 详细工作流程**

想象Agent是一个**主动汇报的员工**，定期向老板汇报工作情况：

```
Agent工作时间表：

09:00:00  Agent想："该汇报CPU使用率了"
09:00:01  Agent测量："当前CPU使用率85%"  
09:00:02  Agent主动联系Server："老板，CPU使用率85%"
09:00:03  Server记录："收到Agent1的CPU数据"

09:01:00  Agent想："又到汇报时间了"
09:01:01  Agent测量："当前CPU使用率90%"
09:01:02  Agent主动联系Server："老板，CPU使用率90%"  
09:01:03  Server记录："收到Agent1的CPU数据"
```

**🔸 技术实现机制**

```
Zabbix Agent工作步骤：
1️⃣ 向Server请求监控任务列表（我需要监控什么？）
2️⃣ 缓存监控项配置（记住要做的事情）
3️⃣ 按计划执行监控检查（到时间就工作）
4️⃣ 收集监控数据（获取实际数值）
5️⃣ 主动发送数据到Server（汇报结果）
6️⃣ 定期更新任务列表（确认工作内容没变化）
```

### 3.2 主动模式的网络通信


**🔸 网络连接方向**

```
网络拓扑图：

┌─────────────────┐         ┌─────────────────┐
│  Zabbix Agent   │ ──────▶ │  Zabbix Server  │
│   (主动汇报端)    │  发起连接  │   (监控中心)     │
│   IP: 10.1.1.101│         │   IP: 10.1.1.100│
│   Port: 随机     │◀────── │   Port: 10051   │
└─────────────────┘  返回任务  └─────────────────┘

数据发送：
┌─────────────────┐         ┌─────────────────┐
│  Zabbix Agent   │ ──────▶ │  Zabbix Server  │
│                 │  推送数据  │                 │
│                 │         │   Port: 10051   │
└─────────────────┘         └─────────────────┘
```

**🔸 防火墙配置要求**

```
网络安全配置：

Zabbix Agent端：
✅ 出站规则：允许连接到Server的10051端口
❌ 入站规则：不需要特殊配置

Zabbix Server端：
❌ 出站规则：不需要特殊配置  
✅ 入站规则：允许Agent连接10051端口

防火墙开放命令示例：
# Server端执行

firewall-cmd --add-port=10051/tcp --permanent
firewall-cmd --reload
```

### 3.3 主动模式的数据缓存机制


**🔸 Agent本地缓存**

```
缓存工作原理：

Agent内存中维护一个数据缓冲区：
┌─────────────────────────────────┐
│ 时间戳    │ 监控项     │ 数值    │
├─────────────────────────────────┤
│ 09:00:01 │ cpu.usage │ 85%    │
│ 09:01:01 │ cpu.usage │ 90%    │  
│ 09:02:01 │ cpu.usage │ 88%    │
│ 09:00:05 │ mem.usage │ 75%    │
│ 09:01:05 │ mem.usage │ 80%    │
└─────────────────────────────────┘

批量发送：每隔一定时间将缓存数据一次性发送给Server
```

**🔸 网络中断容错**

```
容错机制：

正常情况：
Agent收集数据 → 立即发送给Server → Server接收处理

网络异常情况：
Agent收集数据 → 发送失败 → 数据暂存本地缓存 → 
网络恢复后 → 补发之前的历史数据

优势：不会因为临时网络问题丢失监控数据
```

### 3.4 主动模式的优势与劣势


**🟢 主动模式优势**

**🔸 Server性能压力小**
```
性能分布：

传统被动模式Server压力：
■■■■■■■■■■ 100% (Server承担所有连接请求)

主动模式Server压力：  
■■■ 30% (Server只接收数据，Agent分担连接工作)
```

**🔸 网络效率高**
- Agent可以批量发送多个监控项数据
- 减少网络连接建立和断开的开销
- 支持数据压缩传输

**🔸 扩展性强**
- Agent分担了连接压力
- Server可以支持更多监控节点
- 适合大规模监控环境

**🔴 主动模式劣势**

**🔸 配置相对复杂**
- 需要配置Agent主动连接参数
- 防火墙规则配置方向相反
- 故障排查相对困难

**🔸 时效性略差**
- Agent按自己的节奏发送数据
- Server无法立即"拉取"最新数据
- 数据延迟取决于Agent发送频率

**🔸 Agent压力增加**
- Agent需要维护任务列表
- 需要处理数据缓存和发送
- 对Agent的稳定性要求更高

---

## 4. ⚖️ 两种模式深度对比


### 4.1 性能对比分析


**🔸 Server负载对比**

```
监控100台服务器，每台20个监控项，1分钟间隔：

被动模式Server工作量：
├─ 建立连接：100台 × 20项 = 2000次/分钟
├─ 发送请求：2000次网络请求
├─ 等待响应：2000次网络等待  
└─ 处理数据：2000个数据点

主动模式Server工作量：
├─ 建立连接：约100次/分钟（Agent主动连接）
├─ 发送请求：0次（Agent主动推送）
├─ 等待响应：0次（被动接收数据）
└─ 处理数据：2000个数据点

性能提升：网络负载降低90%以上
```

**🔸 网络流量对比**

| 监控场景 | **被动模式流量** | **主动模式流量** | **优化效果** |
|---------|----------------|----------------|-------------|
| 🔸 **小规模**(10台) | `可接受` | `略有优势` | `差异不明显` |
| 🔸 **中等规模**(100台) | `较高压力` | `明显优势` | `流量减少60%` |
| 🔸 **大规模**(1000台) | `可能瓶颈` | `显著优势` | `流量减少80%` |

### 4.2 网络需求差异


**🔸 网络连通性要求**

```
网络环境适应性：

复杂网络环境（多层NAT、防火墙）：
┌─────────────┐    ┌─────────┐    ┌─────────────┐
│   Internet  │    │  NAT/   │    │  Internal   │
│   Server    │◀───│ Firewall│◀───│   Agent     │
└─────────────┘    └─────────┘    └─────────────┘

被动模式问题：
- Server无法直接连接到内网Agent
- 需要复杂的端口映射配置
- 防火墙策略配置困难

主动模式优势：
- Agent可以穿透NAT主动连接Server
- 类似网页浏览，连接方向简单
- 防火墙配置相对简单
```

**🔸 云环境适应性**

```
云环境监控场景：

传统数据中心：
✅ 被动模式：网络环境可控，适合使用
✅ 主动模式：同样适用，看具体需求

混合云环境：
❌ 被动模式：云主机IP动态变化，连接困难
✅ 主动模式：Agent主动连接固定Server，无问题

边缘计算环境：
❌ 被动模式：网络不稳定，连接成功率低
✅ 主动模式：Agent可以在网络可用时主动汇报
```

### 4.3 安全性考虑


**🔸 网络安全影响**

```
安全角度分析：

被动模式安全特点：
🔸 Server主动连接，连接方向单一
🔸 Agent端口固定开放（10050）
🔸 防火墙策略相对简单
⚠️ Server需要知道所有Agent的IP地址

主动模式安全特点：  
🔸 Agent主动连接，更灵活
🔸 Server端口开放（10051）
🔸 Agent无需开放入站端口
✅ Agent可以使用加密连接
```

**🔸 认证和加密**

| 安全特性 | **被动模式** | **主动模式** | **安全建议** |
|---------|-------------|-------------|-------------|
| 🔐 **连接加密** | `支持TLS` | `支持TLS` | `生产环境必须启用` |
| 🎫 **身份认证** | `IP白名单` | `预共享密钥` | `根据环境选择方式` |
| 🛡️ **防火墙影响** | `需开放Agent端口` | `需开放Server端口` | `最小化端口开放` |

---

## 5. 🔄 混合模式应用策略


### 5.1 混合模式的实际意义


**🤔 为什么要混合使用？**

实际的监控环境往往很复杂，不同的服务器可能有不同的特点：

```
企业监控环境示例：

内网核心服务器（数据库、应用服务器）：
├─ 网络环境：稳定可控
├─ 重要性：极高，需要实时监控
├─ 监控频率：秒级监控
└─ 适合模式：被动检查（严格控制）

外网Web服务器（CDN节点、边缘服务器）：
├─ 网络环境：复杂多变
├─ 重要性：高，但可容忍短暂中断
├─ 监控频率：分钟级监控  
└─ 适合模式：主动检查（穿透NAT）

办公设备（打印机、路由器）：
├─ 网络环境：简单稳定
├─ 重要性：中等
├─ 监控频率：小时级监控
└─ 适合模式：被动检查（简单配置）
```

### 5.2 混合模式配置策略


**🔸 基于服务器类型分配**

```
配置决策树：

服务器是否在内网？
├─ 是 → 网络是否稳定？
│   ├─ 是 → 监控频率高吗？
│   │   ├─ 是 → 使用被动模式
│   │   └─ 否 → 使用主动模式
│   └─ 否 → 使用主动模式
└─ 否 → 能否从外网连接到服务器？
    ├─ 是 → 使用被动模式
    └─ 否 → 使用主动模式
```

**🔸 基于监控项类型分配**

| 监控项类型 | **推荐模式** | **原因说明** |
|-----------|-------------|-------------|
| 🔸 **系统基础指标**(CPU、内存) | `主动模式` | `数据量大，适合批量发送` |
| 🔸 **关键服务状态**(数据库连接) | `被动模式` | `需要实时检查服务可用性` |
| 🔸 **日志监控**(错误日志) | `主动模式` | `数据产生不规律，主动推送更好` |
| 🔸 **网络连通性**(ping检查) | `被动模式` | `需要从外部视角检查` |

### 5.3 混合模式最佳实践


**🔸 实施步骤建议**

```
混合模式部署流程：

第一阶段：建立基础监控
1️⃣ 对所有服务器先使用被动模式
2️⃣ 确保基本监控功能正常
3️⃣ 熟悉Zabbix基本操作

第二阶段：识别优化需求  
1️⃣ 观察Server性能压力
2️⃣ 识别网络连接问题的服务器
3️⃣ 统计监控数据量和频率

第三阶段：逐步切换到主动模式
1️⃣ 选择网络环境复杂的服务器优先切换
2️⃣ 选择监控项多的服务器切换
3️⃣ 保留关键业务服务器使用被动模式
```

> 💡 **实用建议**  
> 新手建议先掌握被动模式，理解了Zabbix基本概念后再学习主动模式。这样学习曲线更平缓，不容易被复杂的配置搞混乱。

---

## 6. 🎯 实际选择指导


### 6.1 环境评估清单


**🔸 技术环境评估**

```
网络环境检查：
□ 服务器是否在NAT后面？
□ 防火墙策略是否复杂？
□ 网络是否经常不稳定？
□ 是否有多层网络设备？

如果多数答案是"是" → 建议主动模式

服务器规模评估：
□ 监控的服务器数量超过50台？
□ 每台服务器的监控项超过30个？  
□ 监控频率需要在1分钟以内？
□ Server CPU经常超过80%？

如果多数答案是"是" → 建议主动模式
```

**🔸 团队技能评估**

```
团队能力检查：
□ 团队对Zabbix使用经验不足？
□ 希望配置尽可能简单？
□ 网络知识相对薄弱？
□ 更重视系统稳定性而非性能？

如果多数答案是"是" → 建议被动模式
```

### 6.2 模式选择决策表


| 应用场景 | **服务器规模** | **网络复杂度** | **团队经验** | **推荐模式** |
|---------|--------------|--------------|-------------|-------------|
| 🏢 **小型企业** | `<20台` | `简单` | `初级` | `被动模式` |
| 🏭 **中型企业** | `20-200台` | `中等` | `中级` | `混合模式` |
| 🌐 **大型企业** | `>200台` | `复杂` | `高级` | `主动模式为主` |
| ☁️ **云环境** | `不限` | `复杂` | `中级以上` | `主动模式` |
| 🔧 **测试环境** | `<10台` | `简单` | `不限` | `被动模式` |

### 6.3 常见问题与解决方案


**🔸 被动模式常见问题**

> ❌ **问题**: "Server连接Agent超时"  
> 🔍 **排查**: 检查Agent端防火墙10050端口  
> ✅ **解决**: `firewall-cmd --add-port=10050/tcp --permanent`

> ❌ **问题**: "监控项变成不支持"  
> 🔍 **排查**: Agent服务是否正常运行  
> ✅ **解决**: `systemctl status zabbix-agent`

**🔸 主动模式常见问题**

> ❌ **问题**: "Agent无法获取监控任务列表"  
> 🔍 **排查**: 检查Server端防火墙10051端口  
> ✅ **解决**: `firewall-cmd --add-port=10051/tcp --permanent`

> ❌ **问题**: "监控数据延迟较大"  
> 🔍 **排查**: 检查Agent配置的发送频率  
> ✅ **解决**: 调整`RefreshActiveChecks`参数

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 监控模式本质：谁主动发起连接和数据传输
🔸 被动检查：Server主动"拉取"数据，类似老师检查作业
🔸 主动检查：Agent主动"推送"数据，类似学生汇报进度  
🔸 网络方向：被动模式Server连Agent，主动模式Agent连Server
🔸 性能特点：被动模式Server压力大，主动模式Agent分担压力
🔸 适用场景：根据网络环境、服务器规模、团队能力选择
```

### 7.2 关键理解要点


**🔹 模式选择不是绝对的**
```
实际应用原则：
- 没有"最好"的模式，只有"最适合"的模式
- 小规模环境两种模式差异不大
- 大规模或复杂网络环境差异显著
- 可以根据具体需求混合使用
```

**🔹 网络配置的关键区别**
```
防火墙配置记忆：
- 被动模式：Agent开10050端口（接收Server连接）
- 主动模式：Server开10051端口（接收Agent连接）
- 端口记忆技巧：50=被动接收，51=主动发送
```

**🔹 性能影响的本质**
```
性能差异根本原因：
- 被动模式：每个监控项需要独立的网络请求
- 主动模式：多个监控项可以批量发送
- 规模越大，差异越明显
- 网络环境越复杂，主动模式优势越大
```

### 7.3 实际应用价值


**🎯 新手学习路径**
1. **起步阶段**: 先学会被动模式，理解基本概念
2. **进阶阶段**: 学习主动模式，理解两者区别
3. **应用阶段**: 根据实际环境选择合适的模式
4. **优化阶段**: 使用混合模式，发挥各自优势

**🛠️ 实际部署建议**
- **新部署**: 建议从被动模式开始，稳定后再考虑优化
- **扩容时**: 超过50台服务器考虑主动模式
- **云环境**: 优先考虑主动模式
- **混合环境**: 核心业务用被动，边缘服务用主动

**🔧 故障排查思路**
- **被动模式故障**: 重点检查Agent端网络和服务状态
- **主动模式故障**: 重点检查Server端网络和Agent配置
- **数据延迟**: 被动模式检查Server性能，主动模式检查Agent发送频率

**核心记忆口诀**：
- 被动检查Server主动，主动检查Agent主动
- 小规模简单用被动，大规模复杂用主动  
- 网络复杂穿透难，主动模式是首选
- 混合使用最灵活，按需选择效果好