---
title: 2、zabbix_sender数据发送工具
---
## 📚 目录

1. [zabbix_sender基础概念](#1-zabbix_sender基础概念)
2. [基本语法与核心参数](#2-基本语法与核心参数)
3. [数据发送模式详解](#3-数据发送模式详解)
4. [实际应用场景](#4-实际应用场景)
5. [错误处理与性能优化](#5-错误处理与性能优化)
6. [核心要点总结](#6-核心要点总结)

---

## 1. 🎯 zabbix_sender基础概念


### 1.1 什么是zabbix_sender


**🔸 简单理解**
```
把zabbix_sender想象成一个"快递员"：
• 你有数据要发送给Zabbix服务器
• zabbix_sender就是负责运输的工具
• 它把你的数据安全送达Zabbix服务器
```

**💡 核心作用**
- **主动推送数据**：不等服务器来取，主动发送数据
- **自定义监控**：监控任何你想监控的指标
- **脚本集成**：在Shell脚本、Python脚本中使用
- **批量处理**：一次发送多个数据

### 1.2 工作原理


**📊 数据流向图**
```
自定义脚本/应用 → zabbix_sender → Zabbix服务器 → 数据库
     ↓               ↓              ↓           ↓
   生成数据         打包发送        接收处理     存储展示
```

**🔄 与传统监控的对比**
```
传统被动监控：
Zabbix服务器 --请求--> Agent --响应--> 返回数据

主动推送监控：
应用程序 --推送--> zabbix_sender --发送--> Zabbix服务器
```

### 1.3 使用场景


**✅ 适合的场景**
- 自定义业务指标监控（订单数量、用户活跃度等）
- 脚本执行结果上报
- 第三方系统数据集成
- 批量历史数据导入

**❌ 不适合的场景**
- 系统基础监控（CPU、内存等）→ 用Agent更好
- 实时性要求极高的监控 → 有网络延迟

---

## 2. ⚙️ 基本语法与核心参数


### 2.1 基本命令结构


**📋 标准语法格式**
```bash
zabbix_sender [选项] [参数]
```

**🎯 最简单的使用示例**
```bash
# 发送一个简单数据
zabbix_sender -z 192.168.1.100 -p 10051 -s "Web-Server-01" -k "custom.orders" -o 1250
```

> 💡 **通俗解释**: 这条命令的意思是"告诉192.168.1.100这台Zabbix服务器，Web-Server-01这台主机的custom.orders这个指标现在的值是1250"

### 2.2 核心参数详解


#### 🌐 服务器连接参数


**-z (server)** - 指定Zabbix服务器地址
```bash
# IP地址方式
zabbix_sender -z 192.168.1.100

# 域名方式  
zabbix_sender -z monitor.company.com

# 多个服务器（高可用）
zabbix_sender -z "192.168.1.100,192.168.1.101"
```

**-p (port)** - 指定服务器端口
```bash
# 默认端口10051
zabbix_sender -z 192.168.1.100 -p 10051

# 自定义端口
zabbix_sender -z 192.168.1.100 -p 20051
```

#### 🏷️ 数据标识参数


**-s (host)** - 指定主机名
```bash
# 主机名必须在Zabbix中已经存在
zabbix_sender -s "Web-Server-01"

# 使用系统主机名
zabbix_sender -s $(hostname)
```

> ⚠️ **重要提醒**: 主机名必须与Zabbix中配置的主机名完全一致，包括大小写

**-k (key)** - 指定监控项键值
```bash
# 自定义键值
zabbix_sender -k "custom.orders.count"

# 系统预定义键值也可以
zabbix_sender -k "system.cpu.load[all,avg1]"
```

**-o (value)** - 指定数值
```bash
# 数字类型
zabbix_sender -o 1250

# 字符串类型  
zabbix_sender -o "系统正常"

# 浮点数
zabbix_sender -o 98.5
```

### 2.3 输入模式参数


#### 📝 文件输入模式


**-i (input-file)** - 从文件读取数据
```bash
# 从文件批量发送
zabbix_sender -z 192.168.1.100 -i /tmp/data.txt
```

**文件格式要求**
```
# data.txt文件内容格式
主机名 键值 数值 [时间戳]

# 实际例子
Web-Server-01 custom.orders 1250
Web-Server-01 custom.users 980  
DB-Server-01 custom.connections 45
```

#### ⏰ 时间相关参数


**-T (timestamp)** - 指定时间戳
```bash
# 使用当前时间（默认）
zabbix_sender -z 192.168.1.100 -s "Web-01" -k "test" -o 100

# 指定历史时间
zabbix_sender -z 192.168.1.100 -s "Web-01" -k "test" -o 100 -T 1695876543
```

### 2.4 输出控制参数


#### 📢 详细输出模式


**-v (verbose)** - 详细输出模式
```bash
# 简单输出
zabbix_sender -z 192.168.1.100 -s "Web-01" -k "test" -o 100

# 详细输出（推荐调试时使用）
zabbix_sender -v -z 192.168.1.100 -s "Web-01" -k "test" -o 100
```

**输出内容对比**
```
普通模式输出：
sent: 1; failed: 0; total: 1; spent: 0.001 seconds

详细模式输出：
zabbix_sender [12345]: DEBUG: answer from "192.168.1.100:10051": "OK"
zabbix_sender [12345]: sent: 1; failed: 0; total: 1; spent: 0.001 seconds
```

**-r (real-time)** - 实时发送模式
```bash
# 每条数据立即发送（默认行为）
zabbix_sender -r -z 192.168.1.100 -s "Web-01" -k "test" -o 100
```

---

## 3. 📊 数据发送模式详解


### 3.1 单条数据发送


**🎯 基本单条发送**
```bash
#!/bin/bash
# 发送当前订单数量
ORDER_COUNT=$(mysql -u user -p'pass' -D shop -e "SELECT COUNT(*) FROM orders WHERE DATE(created_at)=CURDATE()" -s -N)

zabbix_sender -z 192.168.1.100 \
              -p 10051 \
              -s "Web-Server-01" \
              -k "business.orders.today" \
              -o $ORDER_COUNT
```

**💡 实际应用示例**
```bash
# 监控网站响应时间
RESPONSE_TIME=$(curl -w "%{time_total}" -s -o /dev/null http://www.example.com)
zabbix_sender -z monitor.company.com -s $(hostname) -k "web.response.time" -o $RESPONSE_TIME

# 监控磁盘使用率
DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | sed 's/%//')
zabbix_sender -z monitor.company.com -s $(hostname) -k "disk.usage.percent" -o $DISK_USAGE
```

### 3.2 批量数据发送


**📁 准备数据文件**
```bash
# 创建数据文件 /tmp/batch_data.txt
cat > /tmp/batch_data.txt << EOF
Web-Server-01 cpu.usage 75.5
Web-Server-01 memory.usage 68.2
Web-Server-01 connections.active 234
DB-Server-01 queries.per.second 1250
DB-Server-01 slow.queries 3
EOF
```

**📤 批量发送命令**
```bash
# 一次性发送所有数据
zabbix_sender -z 192.168.1.100 -i /tmp/batch_data.txt -v
```

### 3.3 带时间戳的历史数据发送


**⏰ 历史数据导入场景**
```bash
# 导入昨天的数据
YESTERDAY_TIMESTAMP=$(date -d "yesterday" +%s)

cat > /tmp/history_data.txt << EOF
Web-Server-01 daily.orders 1580 $YESTERDAY_TIMESTAMP
Web-Server-01 daily.revenue 25600.50 $YESTERDAY_TIMESTAMP  
EOF

zabbix_sender -z 192.168.1.100 -i /tmp/history_data.txt
```

---

## 4. 🛠️ 实际应用场景


### 4.1 业务指标监控


**📈 电商网站监控示例**
```bash
#!/bin/bash
# 每5分钟执行的业务监控脚本

ZABBIX_SERVER="192.168.1.100"
HOST_NAME="Web-Server-01"

# 今日订单数
ORDERS_TODAY=$(mysql -u monitor -p'password' -D ecommerce \
               -e "SELECT COUNT(*) FROM orders WHERE DATE(created_at)=CURDATE()" -s -N)

# 在线用户数
ONLINE_USERS=$(redis-cli GET online_users 2>/dev/null || echo 0)

# 页面响应时间
RESPONSE_TIME=$(curl -w "%{time_total}" -s -o /dev/null http://localhost/api/health)

# 发送数据到Zabbix
zabbix_sender -z $ZABBIX_SERVER -s $HOST_NAME -k "business.orders.today" -o $ORDERS_TODAY
zabbix_sender -z $ZABBIX_SERVER -s $HOST_NAME -k "business.users.online" -o $ONLINE_USERS  
zabbix_sender -z $ZABBIX_SERVER -s $HOST_NAME -k "web.response.time" -o $RESPONSE_TIME
```

### 4.2 应用程序集成


**🐍 Python脚本集成**
```python
#!/usr/bin/env python3
import subprocess
import json
import requests

def send_to_zabbix(host, key, value):
    """发送数据到Zabbix"""
    cmd = [
        'zabbix_sender',
        '-z', '192.168.1.100',
        '-s', host,
        '-k', key, 
        '-o', str(value)
    ]
    
    try:
        result = subprocess.run(cmd, capture_output=True, text=True)
        if result.returncode == 0:
            print(f"发送成功: {key} = {value}")
        else:
            print(f"发送失败: {result.stderr}")
    except Exception as e:
        print(f"执行错误: {e}")

# 使用示例
if __name__ == "__main__":
    # 获取API响应时间
    response = requests.get('http://api.example.com/status')
    response_time = response.elapsed.total_seconds()
    
    # 发送到Zabbix
    send_to_zabbix('API-Server-01', 'api.response.time', response_time)
    send_to_zabbix('API-Server-01', 'api.status.code', response.status_code)
```

### 4.3 定时任务集成


**⏰ Crontab定时发送**
```bash
# 编辑crontab
crontab -e

# 添加定时任务
# 每5分钟检查一次业务指标
*/5 * * * * /opt/scripts/business_monitor.sh >/dev/null 2>&1

# 每小时发送一次汇总数据  
0 * * * * /opt/scripts/hourly_report.sh >/dev/null 2>&1

# 每天凌晨发送昨日汇总
0 1 * * * /opt/scripts/daily_summary.sh >/dev/null 2>&1
```

---

## 5. 🔧 错误处理与性能优化


### 5.1 常见错误与解决方案


**❌ 连接错误**
```bash
# 错误信息
zabbix_sender: cannot connect to [[192.168.1.100]:10051]: Connection refused

# 解决方案检查清单
1. 检查网络连通性: ping 192.168.1.100  
2. 检查端口开放: telnet 192.168.1.100 10051
3. 检查防火墙设置
4. 确认Zabbix Server服务运行状态
```

**❌ 主机不存在错误**
```bash
# 错误信息  
sent: 0; failed: 1; total: 1; error list:
[Web-Server-01:custom.test] failed: No such host

# 解决方案
1. 确认主机名在Zabbix中已创建
2. 检查主机名拼写（区分大小写）
3. 确认主机状态为"已启用"
```

**❌ 监控项不存在错误**
```bash
# 错误信息
[Web-Server-01:custom.test] failed: No such item

# 解决方案  
1. 确认监控项类型设置为"Zabbix trapper"
2. 检查键值名称是否正确
3. 确认监控项状态为"已启用"
```

### 5.2 性能优化技巧


**⚡ 批量发送优化**

| 发送方式 | **性能** | **网络负载** | **适用场景** |
|---------|---------|-------------|-------------|
| 单条发送 | 低 | 高 | 少量数据，实时性要求高 |
| 批量发送 | 高 | 低 | 大量数据，可接受延迟 |

```bash
# 低效方式：多次单条发送
for metric in cpu memory disk; do
    zabbix_sender -z server -s host -k $metric -o $value
done

# 高效方式：一次批量发送
cat > /tmp/metrics.txt << EOF
host cpu.usage 75
host memory.usage 68  
host disk.usage 82
EOF
zabbix_sender -z server -i /tmp/metrics.txt
```

**🚀 脚本优化技巧**
```bash
#!/bin/bash
# 优化后的监控脚本

# 1. 使用临时文件减少网络请求
TEMP_FILE="/tmp/zabbix_data_$$"
ZABBIX_SERVER="192.168.1.100"
HOST_NAME=$(hostname)

# 2. 收集所有数据到临时文件
{
    echo "$HOST_NAME custom.metric1 $(get_metric1)"
    echo "$HOST_NAME custom.metric2 $(get_metric2)"  
    echo "$HOST_NAME custom.metric3 $(get_metric3)"
} > $TEMP_FILE

# 3. 一次性发送所有数据
zabbix_sender -z $ZABBIX_SERVER -i $TEMP_FILE

# 4. 清理临时文件
rm -f $TEMP_FILE
```

### 5.3 调试与故障排查


**🔍 调试模式使用**
```bash
# 开启详细输出调试
zabbix_sender -v -z 192.168.1.100 -s "Web-01" -k "test" -o 100

# 输出解释
INFO [Z:192.168.1.100:10051] send value 'test:100'
INFO [Z:192.168.1.100:10051] sent: 1; failed: 0; total: 1; spent: 0.001 seconds
```

**📝 日志记录最佳实践**
```bash
#!/bin/bash
# 带日志记录的发送脚本

LOG_FILE="/var/log/zabbix_sender.log"
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

# 发送数据并记录日志
send_metric() {
    local key=$1
    local value=$2
    
    result=$(zabbix_sender -z 192.168.1.100 -s $(hostname) -k "$key" -o "$value" 2>&1)
    echo "[$TIMESTAMP] $key=$value | $result" >> $LOG_FILE
}

# 使用示例
send_metric "custom.orders" 1250
send_metric "custom.users" 890
```

---

## 6. 📋 核心要点总结


### 6.1 必须掌握的基础概念


**🔸 核心理解**
```
zabbix_sender = 数据投递员
• 主动推送：不等服务器来取，主动发送
• 灵活定制：可以发送任何自定义数据  
• 脚本友好：与各种脚本语言完美集成
• 批量高效：支持一次发送多个数据
```

**🔸 必知参数**
- **-z**: 服务器地址（必需）
- **-s**: 主机名（必需，要与Zabbix中一致）
- **-k**: 键值名（必需，监控项要设置为Trapper类型）
- **-o**: 数值（必需）
- **-i**: 批量文件输入
- **-v**: 详细输出（调试用）

### 6.2 实际应用要点


**💡 监控项配置要求**
```
在Zabbix中创建监控项时：
1. 类型必须选择"Zabbix trapper"
2. 键值要与-k参数完全一致
3. 数据类型要匹配（数值/字符/日志等）
```

**💡 最佳实践建议**
```
性能优化：
• 优先使用批量发送(-i参数)
• 避免频繁的单条发送
• 合理设置发送频率

错误处理：
• 使用-v参数调试问题
• 检查网络连通性
• 确认主机和监控项配置正确

安全考虑：
• 控制脚本执行权限
• 注意数据传输安全
• 定期清理临时文件
```

### 6.3 常用命令模板


**📝 快速参考**
```bash
# 单条数据发送模板
zabbix_sender -z [服务器IP] -s [主机名] -k [键值] -o [数值]

# 批量数据发送模板  
zabbix_sender -z [服务器IP] -i [数据文件]

# 带调试的发送模板
zabbix_sender -v -z [服务器IP] -s [主机名] -k [键值] -o [数值]

# 脚本集成模板
#!/bin/bash
VALUE=$(your_command_here)
zabbix_sender -z 192.168.1.100 -s $(hostname) -k "custom.metric" -o $VALUE
```

**🎯 学习检查清单**
- [ ] 理解zabbix_sender的作用和工作原理
- [ ] 掌握基本参数的使用方法
- [ ] 会创建Trapper类型的监控项
- [ ] 能够编写简单的数据发送脚本
- [ ] 了解批量发送的优势和用法
- [ ] 知道常见错误的排查方法

**💭 记忆口诀**
> zabbix_sender是投递员，主动推送很方便  
> -z服务器-s主机名，-k键值-o是数值  
> Trapper类型要设对，批量发送更高效

**🔑 一句话总结**：zabbix_sender是让你能够主动向Zabbix服务器推送任何自定义数据的强大工具，特别适合业务指标监控和脚本集成场景。