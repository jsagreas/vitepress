---
title: 4ã€æ¨¡æ¿ç®¡ç†-ç»´æŠ¤
---
## ğŸ“š ç›®å½•


1. [æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ](#1-æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ)
2. [æ¨¡æ¿æ‰¹é‡æ›´æ–°ç­–ç•¥](#2-æ¨¡æ¿æ‰¹é‡æ›´æ–°ç­–ç•¥)
3. [æ¨¡æ¿å†²çªå¤„ç†æœºåˆ¶](#3-æ¨¡æ¿å†²çªå¤„ç†æœºåˆ¶)
4. [æ¨¡æ¿æ€§èƒ½ä¼˜åŒ–å®è·µ](#4-æ¨¡æ¿æ€§èƒ½ä¼˜åŒ–å®è·µ)
5. [æ¨¡æ¿å…±äº«ä¸å‘å¸ƒ](#5-æ¨¡æ¿å…±äº«ä¸å‘å¸ƒ)
6. [æ¨¡æ¿å¤‡ä»½æ¢å¤æ–¹æ¡ˆ](#6-æ¨¡æ¿å¤‡ä»½æ¢å¤æ–¹æ¡ˆ)
7. [æ¨¡æ¿è¿ç§»æœ€ä½³å®è·µ](#7-æ¨¡æ¿è¿ç§»æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ·ï¸ æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ



### 1.1 æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶çš„é‡è¦æ€§



**ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶ï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªå®¶åº­ç›¸å†Œï¼Œéšç€æ—¶é—´æ¨ç§»ä¸æ–­æ·»åŠ æ–°ç…§ç‰‡ã€‚å¦‚æœæ²¡æœ‰åˆ†ç±»å’Œæ ‡è®°ï¼Œå‡ å¹´åä½ å°±å¾ˆéš¾æ‰¾åˆ°æŸå¼ ç‰¹å®šçš„ç…§ç‰‡ï¼Œä¹Ÿä¸çŸ¥é“å“ªäº›æ˜¯æœ€æ–°çš„ã€‚

Zabbixæ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶å°±æ˜¯è¿™æ ·çš„"ç›¸å†Œç®¡ç†ç³»ç»Ÿ"ï¼š

```
æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶çš„é—®é¢˜ï¼š
ç”¨æˆ·åœºæ™¯                     é—®é¢˜è¡¨ç°
ä¿®æ”¹æ¨¡æ¿ â†’ ç³»ç»Ÿæ•…éšœ         ä¸çŸ¥é“æ”¹äº†ä»€ä¹ˆï¼Œæ— æ³•å›é€€
å¤šäººåä½œ â†’ ç‰ˆæœ¬æ··ä¹±         ä¸çŸ¥é“è°æ”¹çš„ï¼Œæ”¹äº†å“ªäº›
æ¨¡æ¿å‡çº§ â†’ åŠŸèƒ½ä¸¢å¤±         æ–°ç‰ˆæœ¬è¦†ç›–äº†è‡ªå®šä¹‰é…ç½®
```

### 1.2 ç‰ˆæœ¬å‘½åè§„èŒƒ



**ğŸ” å»ºç«‹æ¸…æ™°çš„å‘½åä½“ç³»**

```
æ¨èçš„ç‰ˆæœ¬å‘½åæ ¼å¼ï¼š
æ¨¡æ¿å_ç‰ˆæœ¬å·_ä¿®æ”¹æ—¥æœŸ_ä¿®æ”¹äºº

å…·ä½“ç¤ºä¾‹ï¼š
Linux_Server_v2.1_20250921_å¼ ä¸‰
â”œâ”€â”€ v2.1ï¼šä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬
â”œâ”€â”€ 20250921ï¼šå¹´æœˆæ—¥
â””â”€â”€ å¼ ä¸‰ï¼šè´Ÿè´£äºº

ç‰ˆæœ¬å·å«ä¹‰ï¼š
ä¸»ç‰ˆæœ¬(2)ï¼šå¤§å¹…ä¿®æ”¹ï¼Œä¸å…¼å®¹æ—§ç‰ˆ
æ¬¡ç‰ˆæœ¬(1)ï¼šåŠŸèƒ½å¢åŠ ï¼Œå‘ä¸‹å…¼å®¹
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**

| ä¿®æ”¹ç±»å‹ | ç‰ˆæœ¬å˜åŒ– | å‘½åç¤ºä¾‹ | ä½¿ç”¨åœºæ™¯ |
|---------|----------|----------|----------|
| **bugä¿®å¤** | `v1.1 â†’ v1.1.1` | `Linux_v1.1.1_bugfix` | ä¿®å¤ç›‘æ§é¡¹é”™è¯¯ |
| **åŠŸèƒ½æ–°å¢** | `v1.1 â†’ v1.2` | `Linux_v1.2_add_disk` | å¢åŠ ç£ç›˜ç›‘æ§ |
| **æ¶æ„é‡æ„** | `v1.2 â†’ v2.0` | `Linux_v2.0_redesign` | å®Œå…¨é‡æ–°è®¾è®¡ |

### 1.3 ç‰ˆæœ¬ç®¡ç†å·¥å…·é›†æˆ



**ğŸ”§ Gitç‰ˆæœ¬æ§åˆ¶é›†æˆ**

```bash
# åˆ›å»ºæ¨¡æ¿ç‰ˆæœ¬åº“

mkdir zabbix-templates
cd zabbix-templates
git init

# ç›®å½•ç»“æ„è®¾è®¡

templates/
â”œâ”€â”€ linux/
â”‚   â”œâ”€â”€ v1.0/
â”‚   â”œâ”€â”€ v2.0/
â”‚   â””â”€â”€ current â†’ v2.0  # è½¯é“¾æ¥æŒ‡å‘å½“å‰ç‰ˆæœ¬
â”œâ”€â”€ windows/
â”œâ”€â”€ database/
â””â”€â”€ network/

# æäº¤æ¨¡æ¿å˜æ›´

git add templates/linux/v2.1/
git commit -m "Linuxæ¨¡æ¿v2.1: å¢åŠ å†…å­˜ç›‘æ§é˜ˆå€¼è°ƒæ•´"
git tag "linux-v2.1"
```

---

## 2. ğŸ”„ æ¨¡æ¿æ‰¹é‡æ›´æ–°ç­–ç•¥



### 2.1 æ‰¹é‡æ›´æ–°çš„æŒ‘æˆ˜



**ä¸ºä»€ä¹ˆæ‰¹é‡æ›´æ–°æ˜¯ä¸ªéš¾é¢˜ï¼Ÿ**

å°±åƒç»™100å°ç”µè„‘åŒæ—¶å®‰è£…è½¯ä»¶ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„æ–¹æ³•ï¼Œå¯èƒ½ä¼šï¼š
- æœ‰äº›å®‰è£…æˆåŠŸï¼Œæœ‰äº›å¤±è´¥
- å®‰è£…è¿‡ç¨‹ä¸­ç”µè„‘å˜æ…¢æˆ–å¡æ­»
- å®‰è£…åå‘ç°è½¯ä»¶ä¸å…¼å®¹

**âš ï¸ å¸¸è§æ‰¹é‡æ›´æ–°é—®é¢˜**

```
åœºæ™¯æè¿°ï¼š
å…¬å¸æœ‰500å°LinuxæœåŠ¡å™¨ï¼Œéƒ½ä½¿ç”¨Linuxæ¨¡æ¿v1.0
ç°åœ¨è¦å‡çº§åˆ°v2.0ï¼Œæ–°å¢äº†ç£ç›˜IOç›‘æ§

å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®é¢˜ç±»å‹        â”‚ å½±å“èŒƒå›´     â”‚ è§£å†³éš¾åº¦ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ éƒ¨åˆ†ä¸»æœºæ›´æ–°å¤±è´¥  â”‚ 50å°ä¸»æœº    â”‚ ä¸­ç­‰    â”‚
â”‚ æ–°ç›‘æ§é¡¹å‘Šè­¦é£æš´  â”‚ å…¨éƒ¨ä¸»æœº    â”‚ é«˜      â”‚
â”‚ å†å²æ•°æ®ä¸¢å¤±     â”‚ å…³é”®ä¸šåŠ¡    â”‚ æé«˜    â”‚
â”‚ æ€§èƒ½å½±å“        â”‚ æ•°æ®åº“      â”‚ é«˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å®‰å…¨çš„æ‰¹é‡æ›´æ–°ç­–ç•¥



**ğŸ¯ åˆ†é˜¶æ®µæ›´æ–°æ–¹æ¡ˆ**

```
ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡å’Œæµ‹è¯•ï¼ˆ1-2å¤©ï¼‰
å‡†å¤‡å·¥ä½œæ¸…å•ï¼š
â–¡ å¤‡ä»½å½“å‰æ¨¡æ¿
â–¡ åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
â–¡ åˆ¶å®šå›é€€æ–¹æ¡ˆ
â–¡ ç¡®å®šæ›´æ–°æ—¶é—´çª—å£

ç¬¬äºŒé˜¶æ®µï¼šå°èŒƒå›´è¯•ç‚¹ï¼ˆ3-5å¤©ï¼‰
è¯•ç‚¹ç­–ç•¥ï¼š
é€‰æ‹©5-10å°éå…³é”®ä¸»æœº â†’ åº”ç”¨æ–°æ¨¡æ¿ â†’ è§‚å¯Ÿ24å°æ—¶
â”œâ”€â”€ æ­£å¸¸ï¼šç»§ç»­ä¸‹ä¸€é˜¶æ®µ
â””â”€â”€ å¼‚å¸¸ï¼šæš‚åœå¹¶åˆ†æé—®é¢˜

ç¬¬ä¸‰é˜¶æ®µï¼šåˆ†æ‰¹æ¬¡æ›´æ–°ï¼ˆ1-2å‘¨ï¼‰
æ‰¹æ¬¡åˆ’åˆ†åŸåˆ™ï¼š
æ‰¹æ¬¡1ï¼šå¼€å‘ç¯å¢ƒï¼ˆ10%ä¸»æœºï¼‰
æ‰¹æ¬¡2ï¼šæµ‹è¯•ç¯å¢ƒï¼ˆ20%ä¸»æœºï¼‰  
æ‰¹æ¬¡3ï¼šé¢„ç”Ÿäº§ç¯å¢ƒï¼ˆ30%ä¸»æœºï¼‰
æ‰¹æ¬¡4ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆ40%ä¸»æœºï¼‰
```

### 2.3 è‡ªåŠ¨åŒ–æ‰¹é‡æ›´æ–°è„šæœ¬



**ğŸš€ Pythonè‡ªåŠ¨åŒ–æ›´æ–°ç¤ºä¾‹**

```python
#!/usr/bin/env python3

# Zabbixæ¨¡æ¿æ‰¹é‡æ›´æ–°è„šæœ¬


import requests
import json
import time
from datetime import datetime

class ZabbixTemplateUpdater:
    def __init__(self, url, username, password):
        self.url = url
        self.auth_token = self.get_auth_token(username, password)
    
    def get_auth_token(self, username, password):
        """è·å–è®¤è¯ä»¤ç‰Œ"""
        payload = {
            "jsonrpc": "2.0",
            "method": "user.login",
            "params": {
                "user": username,
                "password": password
            },
            "id": 1
        }
        response = requests.post(self.url, json=payload)
        return response.json()["result"]
    
    def update_hosts_template(self, host_ids, old_template_id, new_template_id):
        """æ‰¹é‡æ›´æ–°ä¸»æœºæ¨¡æ¿"""
        success_count = 0
        failed_hosts = []
        
        for host_id in host_ids:
            try:
#                # ç§»é™¤æ—§æ¨¡æ¿
                self.unlink_template(host_id, old_template_id)
                time.sleep(1)  # é¿å…APIé™åˆ¶
                
#                # åº”ç”¨æ–°æ¨¡æ¿
                self.link_template(host_id, new_template_id)
                success_count += 1
                
                print(f"ä¸»æœº {host_id} æ›´æ–°æˆåŠŸ")
                
            except Exception as e:
                failed_hosts.append({"host_id": host_id, "error": str(e)})
                print(f"ä¸»æœº {host_id} æ›´æ–°å¤±è´¥: {e}")
        
        return {
            "success_count": success_count,
            "failed_hosts": failed_hosts
        }

# ä½¿ç”¨ç¤ºä¾‹

updater = ZabbixTemplateUpdater(
    url="http://zabbix.company.com/api_jsonrpc.php",
    username="admin",
    password="your_password"
)

# åˆ†æ‰¹æ¬¡æ›´æ–°

batch_1_hosts = [100, 101, 102, 103, 104]  # ç¬¬ä¸€æ‰¹æ¬¡ä¸»æœºID
result = updater.update_hosts_template(
    host_ids=batch_1_hosts,
    old_template_id=10001,  # æ—§æ¨¡æ¿ID
    new_template_id=10002   # æ–°æ¨¡æ¿ID
)

print(f"æ›´æ–°å®Œæˆï¼šæˆåŠŸ {result['success_count']} å°ï¼Œå¤±è´¥ {len(result['failed_hosts'])} å°")
```

---

## 3. âš ï¸ æ¨¡æ¿å†²çªå¤„ç†æœºåˆ¶



### 3.1 æ¨¡æ¿å†²çªçš„æ ¹æœ¬åŸå› 



**ä»€ä¹ˆæ˜¯æ¨¡æ¿å†²çªï¼Ÿ**

æƒ³è±¡ä½ åœ¨è£…ä¿®æˆ¿å­ï¼ŒåŒæ—¶è¯·äº†ä¸¤ä¸ªè£…ä¿®é˜Ÿï¼š
- é˜Ÿä¼Aè¯´ï¼š"å®¢å…è¦åˆ·ç™½è‰²"
- é˜Ÿä¼Bè¯´ï¼š"å®¢å…è¦åˆ·è“è‰²"

è¿™å°±äº§ç”Ÿäº†å†²çªï¼Œä¸çŸ¥é“å¬è°çš„ã€‚

**ğŸ” Zabbixä¸­çš„å†²çªç±»å‹**

```
å†²çªç±»å‹åˆ†æï¼š
                    
åç§°å†²çªï¼š
æ¨¡æ¿A: ç›‘æ§é¡¹åç§° "CPUä½¿ç”¨ç‡"
æ¨¡æ¿B: ç›‘æ§é¡¹åç§° "CPUä½¿ç”¨ç‡"
ç»“æœï¼šç³»ç»Ÿä¸çŸ¥é“ä½¿ç”¨å“ªä¸ªå®šä¹‰

é”®å€¼å†²çªï¼š
æ¨¡æ¿A: system.cpu.util[,user]
æ¨¡æ¿B: system.cpu.util[,user]  
ç»“æœï¼šé‡å¤æ”¶é›†åŒæ ·æ•°æ®ï¼Œæµªè´¹èµ„æº

è§¦å‘å™¨é€»è¾‘å†²çªï¼š
æ¨¡æ¿A: CPU > 80% æŠ¥è­¦
æ¨¡æ¿B: CPU > 90% æŠ¥è­¦
ç»“æœï¼šä¸çŸ¥é“æŒ‰å“ªä¸ªæ ‡å‡†æŠ¥è­¦
```

### 3.2 å†²çªæ£€æµ‹æ–¹æ³•



**ğŸ“Š å†²çªè¯†åˆ«ç­–ç•¥**

```
1. é¢„é˜²æ€§æ£€æµ‹ï¼ˆåº”ç”¨æ¨¡æ¿å‰ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æµ‹é¡¹ç›®     â”‚ æ£€æµ‹æ–¹æ³•    â”‚ å¤„ç†å»ºè®® â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç›‘æ§é¡¹é”®å€¼   â”‚ è‡ªåŠ¨æ‰«æ    â”‚ é‡å‘½å   â”‚
â”‚ è§¦å‘å™¨åç§°   â”‚ åç§°æ¯”å¯¹    â”‚ åˆå¹¶     â”‚
â”‚ å›¾å½¢é…ç½®     â”‚ ä¾èµ–æ£€æŸ¥    â”‚ é€‰æ‹©     â”‚
â”‚ å®å®šä¹‰      â”‚ å˜é‡å†²çª    â”‚ è¦†ç›–     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. è¿è¡Œæ—¶æ£€æµ‹ï¼ˆæ¨¡æ¿è¿è¡Œä¸­ï¼‰
ç›‘æ§æŒ‡æ ‡ï¼š
- é‡å¤æ•°æ®æ”¶é›†ç‡
- å‘Šè­¦é‡å¤ç‡  
- æ€§èƒ½å½±å“ç¨‹åº¦
```

**ğŸ› ï¸ å†²çªè§£å†³å·¥å…·**

```python
def detect_template_conflicts(template1_id, template2_id):
    """æ£€æµ‹ä¸¤ä¸ªæ¨¡æ¿ä¹‹é—´çš„å†²çª"""
    
    conflicts = {
        "item_key_conflicts": [],      # ç›‘æ§é¡¹é”®å€¼å†²çª
        "trigger_name_conflicts": [],  # è§¦å‘å™¨åç§°å†²çª
        "macro_conflicts": []          # å®å®šä¹‰å†²çª
    }
    
#    # è·å–æ¨¡æ¿å†…å®¹
    template1_items = get_template_items(template1_id)
    template2_items = get_template_items(template2_id)
    
#    # æ£€æµ‹ç›‘æ§é¡¹é”®å€¼å†²çª
    for item1 in template1_items:
        for item2 in template2_items:
            if item1["key_"] == item2["key_"]:
                conflicts["item_key_conflicts"].append({
                    "key": item1["key_"],
                    "template1_name": item1["name"],
                    "template2_name": item2["name"]
                })
    
    return conflicts

# ä½¿ç”¨ç¤ºä¾‹

conflicts = detect_template_conflicts(10001, 10002)
if conflicts["item_key_conflicts"]:
    print("å‘ç°ç›‘æ§é¡¹é”®å€¼å†²çªï¼š")
    for conflict in conflicts["item_key_conflicts"]:
        print(f"é”®å€¼: {conflict['key']}")
        print(f"æ¨¡æ¿1: {conflict['template1_name']}")
        print(f"æ¨¡æ¿2: {conflict['template2_name']}")
```

### 3.3 å†²çªè§£å†³ç­–ç•¥



**ğŸ¯ åˆ†ç±»å¤„ç†æ–¹æ¡ˆ**

```
è§£å†³ç­–ç•¥çŸ©é˜µï¼š

é«˜ä¼˜å…ˆçº§å†²çªï¼ˆç«‹å³å¤„ç†ï¼‰ï¼š
é—®é¢˜ç±»å‹              å¤„ç†æ–¹æ³•                     æ—¶é—´è¦æ±‚
å®‰å…¨ç›‘æ§å†²çª          ä¿ç•™æ›´ä¸¥æ ¼çš„è§„åˆ™              ç«‹å³
å…³é”®ä¸šåŠ¡ç›‘æ§å†²çª      æ‰‹åŠ¨åˆå¹¶ç›‘æ§é€»è¾‘              24å°æ—¶å†…
æ•°æ®æ”¶é›†å†²çª          å»é‡å¹¶ä¼˜åŒ–æ”¶é›†é¢‘ç‡            48å°æ—¶å†…

ä¸­ä¼˜å…ˆçº§å†²çªï¼ˆè®¡åˆ’å¤„ç†ï¼‰ï¼š
æ€§èƒ½ç›‘æ§å†²çª          ç»Ÿä¸€ç›‘æ§æ ‡å‡†                  1å‘¨å†…
å‘Šè­¦é˜ˆå€¼å†²çª          æ ¹æ®å†å²æ•°æ®è°ƒæ•´              2å‘¨å†…
æŠ¥è¡¨é…ç½®å†²çª          é‡æ–°è®¾è®¡æŠ¥è¡¨ç»“æ„              1ä¸ªæœˆå†…

ä½ä¼˜å…ˆçº§å†²çªï¼ˆå¯å»¶åï¼‰ï¼š
æ˜¾ç¤ºåç§°å†²çª          ç»Ÿä¸€å‘½åè§„èŒƒ                  ä¸‹ä¸ªç‰ˆæœ¬
å›¾å½¢æ ·å¼å†²çª          é€‰æ‹©ä¸»è¦æ ·å¼                  ä¸‹ä¸ªç‰ˆæœ¬
```

---

## 4. âš¡ æ¨¡æ¿æ€§èƒ½ä¼˜åŒ–å®è·µ



### 4.1 æ€§èƒ½é—®é¢˜çš„è¡¨ç°



**ğŸ” å¦‚ä½•å‘ç°æ¨¡æ¿æ€§èƒ½é—®é¢˜ï¼Ÿ**

å°±åƒæ±½è½¦æ²¹è€—çªç„¶å˜é«˜ï¼Œä½ éœ€è¦æ£€æŸ¥æ˜¯ä¸æ˜¯å‘åŠ¨æœºæœ‰é—®é¢˜ï¼š

```
æ€§èƒ½é—®é¢˜ç—‡çŠ¶ï¼š
                    
ç”¨æˆ·ä½“éªŒå±‚é¢ï¼š
- ç›‘æ§é¡µé¢åŠ è½½ç¼“æ…¢ï¼ˆ>5ç§’ï¼‰
- å›¾å½¢ç»˜åˆ¶æ—¶é—´é•¿ï¼ˆ>10ç§’ï¼‰
- å‘Šè­¦å»¶è¿Ÿï¼ˆ>1åˆ†é’Ÿï¼‰
- ç³»ç»Ÿå“åº”æ…¢

æŠ€æœ¯æŒ‡æ ‡å±‚é¢ï¼š
- æ•°æ®åº“æŸ¥è¯¢æ—¶é—´é•¿
- å†…å­˜ä½¿ç”¨ç‡é«˜
- CPUä½¿ç”¨ç‡æŒç»­é«˜ä½
- ç½‘ç»œIOå¼‚å¸¸
```

**ğŸ“Š æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿**

```
æ€§èƒ½æŒ‡æ ‡ç›‘æ§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒ‡æ ‡åç§°        â”‚ æ­£å¸¸èŒƒå›´   â”‚ å‘Šè­¦é˜ˆå€¼  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç›‘æ§é¡¹æ•°é‡      â”‚ <50000    â”‚ >80000   â”‚
â”‚ å¹³å‡æŸ¥è¯¢æ—¶é—´    â”‚ <100ms    â”‚ >500ms   â”‚
â”‚ æ•°æ®åº“å¤§å°      â”‚ <100GB    â”‚ >500GB   â”‚
â”‚ å¹¶å‘è¿æ¥æ•°      â”‚ <200      â”‚ >800     â”‚
â”‚ å†…å­˜ä½¿ç”¨ç‡      â”‚ <70%      â”‚ >90%     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç›‘æ§é¡¹ä¼˜åŒ–ç­–ç•¥



**ğŸ¯ å‡å°‘ä¸å¿…è¦çš„æ•°æ®æ”¶é›†**

```
ä¼˜åŒ–åŸåˆ™ï¼š

1. æ”¶é›†é¢‘ç‡ä¼˜åŒ–
ç›‘æ§é¡¹ç±»å‹              å»ºè®®é¢‘ç‡      åŸå› è¯´æ˜
CPUã€å†…å­˜ä½¿ç”¨ç‡         30ç§’         å˜åŒ–é¢‘ç¹ï¼Œéœ€è¦å®æ—¶ç›‘æ§
ç£ç›˜ç©ºé—´               5åˆ†é’Ÿ        å˜åŒ–è¾ƒæ…¢ï¼Œé¢‘ç¹æ£€æŸ¥æµªè´¹èµ„æº
ç½‘ç»œæ¥å£çŠ¶æ€           1åˆ†é’Ÿ        ä¸­ç­‰å˜åŒ–é¢‘ç‡
ç³»ç»Ÿè¿è¡Œæ—¶é—´           1å°æ—¶        å‡ ä¹ä¸å˜ï¼Œå¾ˆå°‘æ£€æŸ¥å³å¯

2. æ•°æ®ä¿ç•™ä¼˜åŒ–  
æ•°æ®ç±»å‹               ä¿ç•™æ—¶é—´      å‹ç¼©ç­–ç•¥
å®æ—¶æ€§èƒ½æ•°æ®           7å¤©          åŸå§‹æ•°æ®
è¶‹åŠ¿åˆ†ææ•°æ®           30å¤©         æ¯å°æ—¶å¹³å‡å€¼
å†å²æŠ¥è¡¨æ•°æ®           1å¹´          æ¯å¤©å¹³å‡å€¼
å½’æ¡£æ•°æ®               5å¹´          æ¯æœˆæ±‡æ€»å€¼
```

**ğŸ’¡ æ™ºèƒ½é‡‡é›†ç­–ç•¥**

```python
# åŠ¨æ€è°ƒæ•´é‡‡é›†é¢‘ç‡çš„ç¤ºä¾‹é€»è¾‘

def adjust_collection_frequency(item_key, current_value, history_values):
    """æ ¹æ®æ•°æ®å˜åŒ–åŠ¨æ€è°ƒæ•´é‡‡é›†é¢‘ç‡"""
    
#    # è®¡ç®—å˜åŒ–ç‡
    change_rate = calculate_change_rate(current_value, history_values)
    
    if change_rate > 0.1:  # å˜åŒ–è¶…è¿‡10%
        return 30   # 30ç§’é‡‡é›†ä¸€æ¬¡
    elif change_rate > 0.05:  # å˜åŒ–è¶…è¿‡5%
        return 60   # 1åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡
    else:
        return 300  # 5åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡

# åº”ç”¨ç¤ºä¾‹

cpu_usage = get_current_cpu_usage()
cpu_history = get_cpu_history(24)  # è·å–24å°æ—¶å†å²æ•°æ®
new_interval = adjust_collection_frequency("cpu.usage", cpu_usage, cpu_history)
update_item_interval("system.cpu.util", new_interval)
```

### 4.3 æ•°æ®åº“ä¼˜åŒ–å®è·µ



**ğŸ”§ ç´¢å¼•ä¼˜åŒ–ç­–ç•¥**

```sql
-- å¸¸ç”¨çš„Zabbixæ€§èƒ½ä¼˜åŒ–SQL

-- 1. ä¸ºå†å²æ•°æ®è¡¨æ·»åŠ ç´¢å¼•
CREATE INDEX idx_history_clock ON history(clock);
CREATE INDEX idx_history_itemid_clock ON history(itemid, clock);

-- 2. æ¸…ç†è¿‡æœŸæ•°æ®
DELETE FROM history 
WHERE clock < UNIX_TIMESTAMP(DATE_SUB(NOW(), INTERVAL 30 DAY));

-- 3. åˆ†åŒºè¡¨ä¼˜åŒ–ï¼ˆMySQL 8.0+ï¼‰
ALTER TABLE history 
PARTITION BY RANGE(clock) (
    PARTITION p202409 VALUES LESS THAN (UNIX_TIMESTAMP('2024-10-01')),
    PARTITION p202410 VALUES LESS THAN (UNIX_TIMESTAMP('2024-11-01')),
    PARTITION p202411 VALUES LESS THAN (UNIX_TIMESTAMP('2024-12-01'))
);

-- 4. æŸ¥è¯¢ä¼˜åŒ–ç¤ºä¾‹
-- åŸå§‹æ…¢æŸ¥è¯¢
SELECT AVG(value) FROM history 
WHERE itemid = 12345 AND clock BETWEEN 1695859200 AND 1695945600;

-- ä¼˜åŒ–åæŸ¥è¯¢ï¼ˆä½¿ç”¨è¶‹åŠ¿è¡¨ï¼‰
SELECT AVG(value_avg) FROM trends 
WHERE itemid = 12345 AND clock BETWEEN 1695859200 AND 1695945600;
```

---

## 5. ğŸŒ æ¨¡æ¿å…±äº«ä¸å‘å¸ƒ



### 5.1 æ¨¡æ¿æ ‡å‡†åŒ–è§„èŒƒ



**ä¸ºä»€ä¹ˆéœ€è¦æ ‡å‡†åŒ–ï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹å›¾ä¹¦é¦†ï¼Œå¦‚æœæ¯æœ¬ä¹¦çš„åˆ†ç±»æ–¹æ³•éƒ½ä¸åŒï¼Œè¯»è€…å°±å¾ˆéš¾æ‰¾åˆ°æƒ³è¦çš„ä¹¦ã€‚æ¨¡æ¿æ ‡å‡†åŒ–å°±æ˜¯å»ºç«‹"å›¾ä¹¦åˆ†ç±»æ³•"ã€‚

**ğŸ“‹ æ¨¡æ¿æ ‡å‡†åŒ–æ¸…å•**

```
å‘½åè§„èŒƒï¼š
æ¨¡æ¿åç§°: [å‚å•†]_[äº§å“]_[ç‰ˆæœ¬]_[ç”¨é€”]
ç¤ºä¾‹: Nginx_WebServer_v1.2_Performance

ç›‘æ§é¡¹è§„èŒƒ:
- é”®å€¼æ ¼å¼: æ¨¡å—.åŠŸèƒ½.è¯¦ç»†æè¿°[å‚æ•°]
- åç§°æ ¼å¼: ä¸­æ–‡æè¿° + è‹±æ–‡æ ‡è¯†
- ç¤ºä¾‹: "CPUä½¿ç”¨ç‡ (system.cpu.util)"

è§¦å‘å™¨è§„èŒƒ:
- ä¸¥é‡ç¨‹åº¦ç»Ÿä¸€: ä¿¡æ¯â†’è­¦å‘Šâ†’ä¸€èˆ¬ä¸¥é‡â†’ä¸¥é‡â†’ç¾éš¾
- è¡¨è¾¾å¼æ ‡å‡†åŒ–: æ—¶é—´çª—å£ã€é˜ˆå€¼è®¾ç½®ç»Ÿä¸€
- æ¢å¤æ¡ä»¶æ˜ç¡®: æ¯ä¸ªå‘Šè­¦éƒ½æœ‰æ¸…æ™°çš„æ¢å¤æ¡ä»¶
```

### 5.2 æ¨¡æ¿æ–‡æ¡£åŒ–è¦æ±‚



**ğŸ“– å®Œæ•´çš„æ¨¡æ¿æ–‡æ¡£ç»“æ„**

```markdown
# LinuxæœåŠ¡å™¨ç›‘æ§æ¨¡æ¿ v2.1


# æ¨¡æ¿æ¦‚è¿°


- **é€‚ç”¨ç³»ç»Ÿ**: CentOS 7+, Ubuntu 18+, RedHat 7+
- **ç›‘æ§èŒƒå›´**: CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€è¿›ç¨‹
- **ä¾èµ–æ¡ä»¶**: Zabbix Agent 5.0+
- **æ›´æ–°æ—¶é—´**: 2024-09-21

# å®‰è£…å‰å‡†å¤‡


â–¡ æ£€æŸ¥Zabbix Agentç‰ˆæœ¬
â–¡ ç¡®è®¤ç½‘ç»œè¿é€šæ€§  
â–¡ é…ç½®ç”¨æˆ·æƒé™
â–¡ æµ‹è¯•ç¯å¢ƒéªŒè¯

# ç›‘æ§é¡¹è¯´æ˜


| ç›‘æ§é¡¹åç§° | é”®å€¼ | é‡‡é›†é¢‘ç‡ | è¯´æ˜ |
|-----------|------|----------|------|
| CPUä½¿ç”¨ç‡ | system.cpu.util | 30s | ç³»ç»ŸCPUå¹³å‡ä½¿ç”¨ç‡ |
| å†…å­˜ä½¿ç”¨ç‡ | vm.memory.util | 30s | ç‰©ç†å†…å­˜ä½¿ç”¨ç™¾åˆ†æ¯” |

# å‘Šè­¦è®¾ç½®


- **CPUå‘Šè­¦**: >80% æŒç»­5åˆ†é’Ÿè§¦å‘è­¦å‘Š
- **å†…å­˜å‘Šè­¦**: >90% æŒç»­3åˆ†é’Ÿè§¦å‘ä¸¥é‡å‘Šè­¦
- **ç£ç›˜å‘Šè­¦**: >85% ç©ºé—´ä½¿ç”¨è§¦å‘è­¦å‘Š

# å¸¸è§é—®é¢˜è§£ç­”


Q: ä¸ºä»€ä¹ˆCPUç›‘æ§é¡¹æ²¡æœ‰æ•°æ®ï¼Ÿ
A: æ£€æŸ¥Agenté…ç½®æ–‡ä»¶ä¸­çš„UserParameterè®¾ç½®

# ç‰ˆæœ¬å†å²


- v2.1: å¢åŠ ç£ç›˜IOç›‘æ§
- v2.0: é‡æ„ç›‘æ§é¡¹ç»“æ„  
- v1.0: åˆå§‹ç‰ˆæœ¬
```

### 5.3 æ¨¡æ¿å‘å¸ƒæµç¨‹



**ğŸš€ æ ‡å‡†å‘å¸ƒæµç¨‹**

```
å‘å¸ƒé˜¶æ®µè§„åˆ’ï¼š

ç¬¬ä¸€é˜¶æ®µï¼šå†…éƒ¨æµ‹è¯•ï¼ˆ1å‘¨ï¼‰
â”œâ”€â”€ å¼€å‘ç¯å¢ƒæµ‹è¯•
â”œâ”€â”€ åŠŸèƒ½å®Œæ•´æ€§éªŒè¯
â”œâ”€â”€ æ€§èƒ½å½±å“è¯„ä¼°
â””â”€â”€ æ–‡æ¡£å®Œå–„

ç¬¬äºŒé˜¶æ®µï¼šå°èŒƒå›´è¯•ç”¨ï¼ˆ2å‘¨ï¼‰  
â”œâ”€â”€ é€‰æ‹©5-10ä¸ªè¯•ç”¨å›¢é˜Ÿ
â”œâ”€â”€ æ”¶é›†ä½¿ç”¨åé¦ˆ
â”œâ”€â”€ ä¿®å¤å‘ç°çš„é—®é¢˜
â””â”€â”€ ä¼˜åŒ–ä½¿ç”¨ä½“éªŒ

ç¬¬ä¸‰é˜¶æ®µï¼šæ­£å¼å‘å¸ƒï¼ˆ1å‘¨ï¼‰
â”œâ”€â”€ æœ€ç»ˆç‰ˆæœ¬ç¡®è®¤
â”œâ”€â”€ å‘å¸ƒè¯´æ˜ç¼–å†™
â”œâ”€â”€ åŸ¹è®­ææ–™å‡†å¤‡
â””â”€â”€ å…¨é¢æ¨å¹¿
```

**ğŸ“¢ æ¨¡æ¿å…±äº«å¹³å°å»ºè®¾**

```
å†…éƒ¨æ¨¡æ¿åº“ç»“æ„ï¼š
company-zabbix-templates/
â”œâ”€â”€ official/          # å®˜æ–¹è®¤è¯æ¨¡æ¿
â”‚   â”œâ”€â”€ linux/
â”‚   â”œâ”€â”€ windows/
â”‚   â””â”€â”€ database/
â”œâ”€â”€ community/         # ç¤¾åŒºè´¡çŒ®æ¨¡æ¿
â”‚   â”œâ”€â”€ contributed/
â”‚   â””â”€â”€ experimental/
â”œâ”€â”€ deprecated/        # åºŸå¼ƒæ¨¡æ¿
â””â”€â”€ docs/             # ä½¿ç”¨æ–‡æ¡£
    â”œâ”€â”€ standards/    # æ ‡å‡†è§„èŒƒ
    â”œâ”€â”€ tutorials/    # ä½¿ç”¨æ•™ç¨‹
    â””â”€â”€ faq/         # å¸¸è§é—®é¢˜
```

---

## 6. ğŸ’¾ æ¨¡æ¿å¤‡ä»½æ¢å¤æ–¹æ¡ˆ



### 6.1 å¤‡ä»½ç­–ç•¥è®¾è®¡



**ä¸ºä»€ä¹ˆæ¨¡æ¿å¤‡ä»½è¿™ä¹ˆé‡è¦ï¼Ÿ**

å°±åƒé‡è¦æ–‡ä»¶è¦æœ‰å¤‡ä»½ä¸€æ ·ï¼Œå¦‚æœæ¨¡æ¿å‡ºé—®é¢˜ï¼Œå¯èƒ½å½±å“æ•´ä¸ªç›‘æ§ç³»ç»Ÿã€‚

**ğŸ”’ å¤šå±‚æ¬¡å¤‡ä»½ç­–ç•¥**

```
å¤‡ä»½å±‚æ¬¡è®¾è®¡ï¼š
                    
å®æ—¶å¤‡ä»½ï¼š
- ç›®çš„ï¼šé˜²æ­¢æ„å¤–åˆ é™¤æˆ–ä¿®æ”¹
- é¢‘ç‡ï¼šæ¯æ¬¡æ¨¡æ¿å˜æ›´åè‡ªåŠ¨å¤‡ä»½
- ä¿ç•™ï¼šæœ€è¿‘10ä¸ªç‰ˆæœ¬
- ä½ç½®ï¼šæ•°æ®åº“å¤‡ä»½è¡¨

æ¯æ—¥å¤‡ä»½ï¼š
- ç›®çš„ï¼šé˜²æ­¢æ•°æ®æŸå
- é¢‘ç‡ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹
- ä¿ç•™ï¼šæœ€è¿‘30å¤©
- ä½ç½®ï¼šæ–‡ä»¶ç³»ç»Ÿå¤‡ä»½

æ¯å‘¨å¤‡ä»½ï¼š
- ç›®çš„ï¼šé•¿æœŸå½’æ¡£
- é¢‘ç‡ï¼šæ¯å‘¨æ—¥å‡Œæ™¨  
- ä¿ç•™ï¼šæœ€è¿‘12å‘¨
- ä½ç½®ï¼šè¿œç¨‹å­˜å‚¨

æ¯æœˆå¤‡ä»½ï¼š
- ç›®çš„ï¼šç‰ˆæœ¬é‡Œç¨‹ç¢‘
- é¢‘ç‡ï¼šæ¯æœˆæœ€åä¸€å¤©
- ä¿ç•™ï¼šæœ€è¿‘24ä¸ªæœˆ
- ä½ç½®ï¼šç¦»çº¿å­˜å‚¨
```

### 6.2 è‡ªåŠ¨åŒ–å¤‡ä»½å®ç°



**ğŸ› ï¸ å¤‡ä»½è„šæœ¬ç¤ºä¾‹**

```bash
#!/bin/bash

# Zabbixæ¨¡æ¿è‡ªåŠ¨å¤‡ä»½è„šæœ¬


# é…ç½®å‚æ•°

BACKUP_DIR="/opt/zabbix-backup/templates"
MYSQL_USER="zabbix_backup"
MYSQL_PASS="backup_password"
MYSQL_DB="zabbix"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•

mkdir -p "${BACKUP_DIR}/${DATE}"

# å¤‡ä»½æ¨¡æ¿æ•°æ®

echo "å¼€å§‹å¤‡ä»½æ¨¡æ¿æ•°æ®..."
mysqldump -u${MYSQL_USER} -p${MYSQL_PASS} ${MYSQL_DB} \
    hosts_templates \
    items \
    triggers \
    graphs \
    applications \
    > "${BACKUP_DIR}/${DATE}/templates_${DATE}.sql"

# å¯¼å‡ºæ¨¡æ¿XMLæ–‡ä»¶

echo "å¯¼å‡ºæ¨¡æ¿XMLæ–‡ä»¶..."
for template_id in $(mysql -u${MYSQL_USER} -p${MYSQL_PASS} -D${MYSQL_DB} \
    -e "SELECT hostid FROM hosts WHERE status=3" -s -N); do
    
    template_name=$(mysql -u${MYSQL_USER} -p${MYSQL_PASS} -D${MYSQL_DB} \
        -e "SELECT host FROM hosts WHERE hostid=${template_id}" -s -N)
    
#    # ä½¿ç”¨Zabbix APIå¯¼å‡ºæ¨¡æ¿
    php export_template.php --template-id=${template_id} \
        --output="${BACKUP_DIR}/${DATE}/${template_name}.xml"
done

# å‹ç¼©å¤‡ä»½æ–‡ä»¶

echo "å‹ç¼©å¤‡ä»½æ–‡ä»¶..."
cd "${BACKUP_DIR}"
tar -czf "templates_backup_${DATE}.tar.gz" "${DATE}/"
rm -rf "${DATE}/"

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™30å¤©ï¼‰

find "${BACKUP_DIR}" -name "templates_backup_*.tar.gz" -mtime +30 -delete

echo "å¤‡ä»½å®Œæˆ: templates_backup_${DATE}.tar.gz"
```

### 6.3 æ¢å¤æ“ä½œæŒ‡å—



**ğŸ”„ åˆ†åœºæ™¯æ¢å¤æ–¹æ¡ˆ**

```
æ¢å¤åœºæ™¯åˆ†ç±»ï¼š

åœºæ™¯1ï¼šå•ä¸ªæ¨¡æ¿è¯¯åˆ é™¤
å½±å“èŒƒå›´ï¼šä¸ªåˆ«ä¸»æœºç›‘æ§ä¸­æ–­
æ¢å¤æ—¶é—´ï¼š5-10åˆ†é’Ÿ
æ¢å¤æ­¥éª¤ï¼š
1. ç¡®è®¤å½±å“èŒƒå›´
2. ä»å¤‡ä»½ä¸­æ‰¾åˆ°å¯¹åº”æ¨¡æ¿XML
3. é€šè¿‡Webç•Œé¢å¯¼å…¥æ¨¡æ¿
4. é‡æ–°å…³è”å—å½±å“ä¸»æœº
5. éªŒè¯ç›‘æ§æ¢å¤æ­£å¸¸

åœºæ™¯2ï¼šæ¨¡æ¿æ‰¹é‡æŸå
å½±å“èŒƒå›´ï¼šå¤§éƒ¨åˆ†ç›‘æ§å¼‚å¸¸
æ¢å¤æ—¶é—´ï¼š30-60åˆ†é’Ÿ  
æ¢å¤æ­¥éª¤ï¼š
1. åœæ­¢ZabbixæœåŠ¡
2. æ¢å¤æ•°æ®åº“å¤‡ä»½
3. é‡å¯ZabbixæœåŠ¡
4. éªŒè¯æ‰€æœ‰æ¨¡æ¿æ­£å¸¸
5. æ£€æŸ¥æ•°æ®æ”¶é›†çŠ¶æ€

åœºæ™¯3ï¼šæ•´ä¸ªé…ç½®åº“æŸå
å½±å“èŒƒå›´ï¼šç›‘æ§ç³»ç»Ÿä¸å¯ç”¨
æ¢å¤æ—¶é—´ï¼š2-4å°æ—¶
æ¢å¤æ­¥éª¤ï¼š
1. é‡å»ºZabbixæ•°æ®åº“
2. æ¢å¤å®Œæ•´æ•°æ®å¤‡ä»½
3. é‡æ–°é…ç½®ç³»ç»Ÿå‚æ•°
4. é€æ­¥æ¢å¤æœåŠ¡
5. å…¨é¢æµ‹è¯•éªŒè¯
```

**âš¡ å¿«é€Ÿæ¢å¤å·¥å…·**

```python
#!/usr/bin/env python3

# æ¨¡æ¿å¿«é€Ÿæ¢å¤å·¥å…·


import os
import sys
import json
import requests
from datetime import datetime

class TemplateRecovery:
    def __init__(self, zabbix_url, username, password):
        self.url = zabbix_url
        self.auth_token = self.get_auth_token(username, password)
    
    def restore_template_from_xml(self, xml_file_path):
        """ä»XMLæ–‡ä»¶æ¢å¤æ¨¡æ¿"""
        try:
            with open(xml_file_path, 'r', encoding='utf-8') as f:
                xml_content = f.read()
            
#            # å¯¼å…¥æ¨¡æ¿
            result = self.import_template(xml_content)
            
            if result:
                print(f"æ¨¡æ¿æ¢å¤æˆåŠŸ: {xml_file_path}")
                return True
            else:
                print(f"æ¨¡æ¿æ¢å¤å¤±è´¥: {xml_file_path}")
                return False
                
        except Exception as e:
            print(f"æ¢å¤è¿‡ç¨‹å‡ºé”™: {str(e)}")
            return False
    
    def batch_restore(self, backup_dir):
        """æ‰¹é‡æ¢å¤æ¨¡æ¿"""
        success_count = 0
        failed_files = []
        
#        # æŸ¥æ‰¾æ‰€æœ‰XMLæ–‡ä»¶
        xml_files = [f for f in os.listdir(backup_dir) if f.endswith('.xml')]
        
        for xml_file in xml_files:
            file_path = os.path.join(backup_dir, xml_file)
            if self.restore_template_from_xml(file_path):
                success_count += 1
            else:
                failed_files.append(xml_file)
        
        print(f"\næ¢å¤å®Œæˆ:")
        print(f"æˆåŠŸ: {success_count} ä¸ªæ¨¡æ¿")
        print(f"å¤±è´¥: {len(failed_files)} ä¸ªæ¨¡æ¿")
        
        if failed_files:
            print("å¤±è´¥çš„æ–‡ä»¶:")
            for file in failed_files:
                print(f"  - {file}")

# ä½¿ç”¨ç¤ºä¾‹

recovery = TemplateRecovery(
    zabbix_url="http://zabbix.company.com/api_jsonrpc.php",
    username="admin", 
    password="admin_password"
)

# ä»å¤‡ä»½ç›®å½•æ¢å¤æ‰€æœ‰æ¨¡æ¿

recovery.batch_restore("/opt/zabbix-backup/templates/20240921_020000/")
```

---

## 7. ğŸš€ æ¨¡æ¿è¿ç§»æœ€ä½³å®è·µ



### 7.1 è¿ç§»åœºæ™¯åˆ†æ



**å¸¸è§çš„è¿ç§»éœ€æ±‚**

```
è¿ç§»ç±»å‹åˆ†æï¼š

ç‰ˆæœ¬å‡çº§è¿ç§»ï¼š
åœºæ™¯ï¼šZabbix 4.4 â†’ 6.0
æŒ‘æˆ˜ï¼šAPIå˜åŒ–ã€æ•°æ®ç»“æ„è°ƒæ•´ã€åŠŸèƒ½åºŸå¼ƒ
é‡ç‚¹ï¼šå…¼å®¹æ€§æµ‹è¯•ã€æ¸è¿›å‡çº§

ç¯å¢ƒè¿ç§»ï¼š
åœºæ™¯ï¼šå¼€å‘ç¯å¢ƒ â†’ ç”Ÿäº§ç¯å¢ƒ
æŒ‘æˆ˜ï¼šé…ç½®å·®å¼‚ã€ç½‘ç»œç¯å¢ƒã€æƒé™è®¾ç½®  
é‡ç‚¹ï¼šç¯å¢ƒé€‚é…ã€å®‰å…¨è€ƒè™‘

å¹³å°è¿ç§»ï¼š
åœºæ™¯ï¼šç‰©ç†æœº â†’ äº‘å¹³å°
æŒ‘æˆ˜ï¼šç›‘æ§å¯¹è±¡å˜åŒ–ã€ç½‘ç»œæ¶æ„è°ƒæ•´
é‡ç‚¹ï¼šç›‘æ§é¡¹è°ƒæ•´ã€ç½‘ç»œé…ç½®
```

### 7.2 è¿ç§»å‰å‡†å¤‡å·¥ä½œ



**ğŸ“‹ è¿ç§»å‡†å¤‡æ¸…å•**

```
æŠ€æœ¯å‡†å¤‡ï¼š
â–¡ ç›®æ ‡ç¯å¢ƒZabbixç‰ˆæœ¬ç¡®è®¤
â–¡ ç½‘ç»œè¿é€šæ€§æµ‹è¯•
â–¡ æ•°æ®åº“å…¼å®¹æ€§æ£€æŸ¥
â–¡ å­˜å‚¨ç©ºé—´è¯„ä¼°
â–¡ æ€§èƒ½åŸºçº¿æµ‹è¯•

æ•°æ®å‡†å¤‡ï¼š
â–¡ å®Œæ•´å¤‡ä»½å½“å‰é…ç½®
â–¡ å¯¼å‡ºæ‰€æœ‰æ¨¡æ¿XML
â–¡ è®°å½•è‡ªå®šä¹‰é…ç½®
â–¡ æ•´ç†ä¾èµ–å…³ç³»æ¸…å•
â–¡ å‡†å¤‡æµ‹è¯•æ•°æ®

æµç¨‹å‡†å¤‡ï¼š
â–¡ åˆ¶å®šè¯¦ç»†è¿ç§»è®¡åˆ’
â–¡ ç¡®å®šå›é€€æ–¹æ¡ˆ
â–¡ å‡†å¤‡éªŒè¯æµ‹è¯•ç”¨ä¾‹  
â–¡ å®‰æ’æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ
â–¡ è®¾ç½®ç›‘æ§å‘Šè­¦æœºåˆ¶
```

### 7.3 è¿ç§»æ‰§è¡Œç­–ç•¥



**ğŸ¯ åˆ†é˜¶æ®µè¿ç§»æ–¹æ¡ˆ**

```
é˜¶æ®µ1ï¼šåŸºç¡€ç¯å¢ƒæ­å»ºï¼ˆ1-2å¤©ï¼‰
å·¥ä½œå†…å®¹ï¼š
1. å®‰è£…ç›®æ ‡Zabbixç¯å¢ƒ
2. é…ç½®åŸºæœ¬ç½‘ç»œè¿æ¥
3. åˆ›å»ºæ•°æ®åº“ç»“æ„
4. éªŒè¯åŸºç¡€åŠŸèƒ½æ­£å¸¸

éªŒæ”¶æ ‡å‡†ï¼š
âœ“ Webç•Œé¢å¯æ­£å¸¸è®¿é—®
âœ“ æ•°æ®åº“è¿æ¥æ­£å¸¸
âœ“ Agenté€šè®¯æµ‹è¯•é€šè¿‡
âœ“ åŸºç¡€ç›‘æ§åŠŸèƒ½å¯ç”¨

é˜¶æ®µ2ï¼šæ ¸å¿ƒæ¨¡æ¿è¿ç§»ï¼ˆ2-3å¤©ï¼‰
å·¥ä½œå†…å®¹ï¼š
1. å¯¼å…¥æ ¸å¿ƒä¸šåŠ¡æ¨¡æ¿
2. è°ƒæ•´æ¨¡æ¿å…¼å®¹æ€§é—®é¢˜
3. é…ç½®å…³é”®ç›‘æ§é¡¹
4. æµ‹è¯•å‘Šè­¦åŠŸèƒ½

éªŒæ”¶æ ‡å‡†ï¼š
âœ“ æ‰€æœ‰æ¨¡æ¿å¯¼å…¥æˆåŠŸ
âœ“ ç›‘æ§é¡¹æ•°æ®æ­£å¸¸æ”¶é›†
âœ“ å‘Šè­¦è§¦å‘æœºåˆ¶æ­£å¸¸
âœ“ å›¾å½¢æ˜¾ç¤ºæ­£ç¡®

é˜¶æ®µ3ï¼šæ•°æ®éªŒè¯å’Œä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰  
å·¥ä½œå†…å®¹ï¼š
1. å¯¹æ¯”å†å²æ•°æ®å‡†ç¡®æ€§
2. ä¼˜åŒ–æ€§èƒ½é…ç½®
3. è°ƒæ•´å‘Šè­¦é˜ˆå€¼
4. å®Œå–„ç”¨æˆ·æƒé™

éªŒæ”¶æ ‡å‡†ï¼š
âœ“ æ•°æ®æ”¶é›†å‡†ç¡®ç‡>99%
âœ“ ç³»ç»Ÿå“åº”æ—¶é—´<3ç§’
âœ“ å‘Šè­¦å‡†ç¡®ç‡>95%
âœ“ ç”¨æˆ·åŠŸèƒ½å®Œæ•´
```

### 7.4 è¿ç§»éªŒè¯æ–¹æ³•



**ğŸ” å…¨é¢éªŒè¯æ¡†æ¶**

```python
#!/usr/bin/env python3

# æ¨¡æ¿è¿ç§»éªŒè¯è„šæœ¬


class MigrationValidator:
    def __init__(self, source_api, target_api):
        self.source = source_api
        self.target = target_api
        self.validation_results = {}
    
    def validate_template_count(self):
        """éªŒè¯æ¨¡æ¿æ•°é‡ä¸€è‡´æ€§"""
        source_count = len(self.source.get_templates())
        target_count = len(self.target.get_templates())
        
        result = {
            "source_count": source_count,
            "target_count": target_count,
            "match": source_count == target_count
        }
        
        self.validation_results["template_count"] = result
        return result
    
    def validate_items_consistency(self):
        """éªŒè¯ç›‘æ§é¡¹ä¸€è‡´æ€§"""
        inconsistencies = []
        
        source_templates = self.source.get_templates()
        target_templates = self.target.get_templates()
        
        for source_template in source_templates:
#            # æŸ¥æ‰¾å¯¹åº”çš„ç›®æ ‡æ¨¡æ¿
            target_template = self.find_matching_template(
                source_template, target_templates
            )
            
            if target_template:
#                # æ¯”è¾ƒç›‘æ§é¡¹
                source_items = self.source.get_template_items(source_template['templateid'])
                target_items = self.target.get_template_items(target_template['templateid'])
                
#                # æ£€æŸ¥ç›‘æ§é¡¹æ•°é‡
                if len(source_items) != len(target_items):
                    inconsistencies.append({
                        "template": source_template['host'],
                        "issue": "item_count_mismatch",
                        "source_count": len(source_items),
                        "target_count": len(target_items)
                    })
                
#                # æ£€æŸ¥å…³é”®ç›‘æ§é¡¹
                for source_item in source_items:
                    matching_item = self.find_matching_item(source_item, target_items)
                    if not matching_item:
                        inconsistencies.append({
                            "template": source_template['host'],
                            "issue": "missing_item",
                            "item_key": source_item['key_']
                        })
        
        self.validation_results["items_consistency"] = {
            "total_issues": len(inconsistencies),
            "issues": inconsistencies
        }
        
        return inconsistencies
    
    def validate_data_collection(self):
        """éªŒè¯æ•°æ®æ”¶é›†æ­£å¸¸"""
        collection_status = {}
        
#        # è·å–æœ€è¿‘1å°æ—¶çš„æ•°æ®æ”¶é›†æƒ…å†µ
        templates = self.target.get_templates()
        
        for template in templates:
            items = self.target.get_template_items(template['templateid'])
            active_items = 0
            collecting_items = 0
            
            for item in items:
                if item['status'] == '0':  # å¯ç”¨çŠ¶æ€
                    active_items += 1
                    
#                    # æ£€æŸ¥æ˜¯å¦æœ‰æœ€è¿‘æ•°æ®
                    latest_data = self.target.get_latest_data(item['itemid'])
                    if latest_data and self.is_recent_data(latest_data):
                        collecting_items += 1
            
            collection_rate = collecting_items / active_items if active_items > 0 else 0
            collection_status[template['host']] = {
                "active_items": active_items,
                "collecting_items": collecting_items,
                "collection_rate": collection_rate
            }
        
        self.validation_results["data_collection"] = collection_status
        return collection_status
    
    def generate_report(self):
        """ç”ŸæˆéªŒè¯æŠ¥å‘Š"""
        report = f"""
# æ¨¡æ¿è¿ç§»éªŒè¯æŠ¥å‘Š

ç”Ÿæˆæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

# æ¨¡æ¿æ•°é‡éªŒè¯


æºç¯å¢ƒæ¨¡æ¿æ•°: {self.validation_results.get('template_count', {}).get('source_count', 'N/A')}
ç›®æ ‡ç¯å¢ƒæ¨¡æ¿æ•°: {self.validation_results.get('template_count', {}).get('target_count', 'N/A')}
æ•°é‡åŒ¹é…: {'âœ“' if self.validation_results.get('template_count', {}).get('match', False) else 'âœ—'}

# ç›‘æ§é¡¹ä¸€è‡´æ€§éªŒè¯


å‘ç°é—®é¢˜æ•°: {self.validation_results.get('items_consistency', {}).get('total_issues', 'N/A')}

# æ•°æ®æ”¶é›†éªŒè¯


"""
        
        collection_data = self.validation_results.get('data_collection', {})
        for template_name, status in collection_data.items():
            rate = status.get('collection_rate', 0)
            report += f"{template_name}: {rate:.1%} ({status.get('collecting_items', 0)}/{status.get('active_items', 0)})\n"
        
        return report

# ä½¿ç”¨ç¤ºä¾‹

validator = MigrationValidator(source_api, target_api)
validator.validate_template_count()
validator.validate_items_consistency() 
validator.validate_data_collection()

print(validator.generate_report())
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 æ¨¡æ¿ç®¡ç†æ ¸å¿ƒåŸåˆ™



```
ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶ï¼šå»ºç«‹å®Œå–„çš„ç‰ˆæœ¬ç®¡ç†ä½“ç³»ï¼Œç¡®ä¿å˜æ›´å¯è¿½æº¯
ğŸ”¸ æ‰¹é‡æ›´æ–°ï¼šé‡‡ç”¨åˆ†é˜¶æ®µã€å°æ‰¹é‡çš„å®‰å…¨æ›´æ–°ç­–ç•¥
ğŸ”¸ å†²çªå¤„ç†ï¼šæå‰é¢„é˜²ï¼ŒåŠæ—¶å‘ç°ï¼Œåˆç†è§£å†³æ¨¡æ¿å†²çª
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæŒç»­ç›‘æ§å’Œä¼˜åŒ–æ¨¡æ¿æ€§èƒ½å½±å“
ğŸ”¸ æ ‡å‡†åŒ–ï¼šå»ºç«‹ç»Ÿä¸€çš„æ¨¡æ¿è§„èŒƒå’Œæ–‡æ¡£æ ‡å‡†
ğŸ”¸ å¤‡ä»½æ¢å¤ï¼šå¤šå±‚æ¬¡å¤‡ä»½ç­–ç•¥ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
ğŸ”¸ è¿ç§»ç®¡ç†ï¼šç³»ç»ŸåŒ–çš„è¿ç§»æµç¨‹å’ŒéªŒè¯æœºåˆ¶
```

### 8.2 å…³é”®å®æ–½è¦ç‚¹



**ğŸ”¹ ç®¡ç†æµç¨‹æ ‡å‡†åŒ–**
```
å»ºç«‹æ ‡å‡†ï¼š
- æ¨¡æ¿å‘½åè§„èŒƒç»Ÿä¸€
- ç‰ˆæœ¬æ§åˆ¶æµç¨‹æ ‡å‡†åŒ–
- å˜æ›´å®¡æ‰¹æœºåˆ¶å®Œå–„
- æ–‡æ¡£æ›´æ–°åŒæ­¥è¿›è¡Œ
```

**ğŸ”¹ æŠ€æœ¯å®ç°è‡ªåŠ¨åŒ–**
```
è‡ªåŠ¨åŒ–å·¥å…·ï¼š
- ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé›†æˆ
- æ‰¹é‡æ›´æ–°è„šæœ¬å·¥å…·
- æ€§èƒ½ç›‘æ§å‘Šè­¦æœºåˆ¶
- å¤‡ä»½æ¢å¤è‡ªåŠ¨åŒ–
```

**ğŸ”¹ å›¢é˜Ÿåä½œè§„èŒƒåŒ–**
```
åä½œæœºåˆ¶ï¼š
- æ˜ç¡®è§’è‰²èŒè´£åˆ†å·¥
- å»ºç«‹æ²Ÿé€šåè°ƒæœºåˆ¶
- åˆ¶å®šåº”æ€¥å“åº”æµç¨‹
- å®šæœŸè¯„ä¼°æ”¹è¿›æœºåˆ¶
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ ä¸šåŠ¡ä»·å€¼ä½“ç°**
- **æé«˜æ•ˆç‡**ï¼šæ ‡å‡†åŒ–æµç¨‹å‡å°‘é‡å¤å·¥ä½œ
- **é™ä½é£é™©**ï¼šå®Œå–„çš„å¤‡ä»½å’Œæµ‹è¯•æœºåˆ¶
- **ä¿è¯è´¨é‡**ï¼šç»Ÿä¸€çš„è§„èŒƒå’ŒéªŒè¯æ ‡å‡†
- **ä¾¿äºç»´æŠ¤**ï¼šæ¸…æ™°çš„ç‰ˆæœ¬æ§åˆ¶å’Œæ–‡æ¡£ä½“ç³»

**ğŸ”§ æŠ€æœ¯ä»·å€¼ä½“ç°**
- **ç³»ç»Ÿç¨³å®š**ï¼šå‡å°‘å› æ¨¡æ¿é—®é¢˜å¯¼è‡´çš„ç›‘æ§ä¸­æ–­
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒç»­çš„æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
- **å¿«é€Ÿæ¢å¤**ï¼šå®Œå–„çš„å¤‡ä»½æ¢å¤æœºåˆ¶
- **é¡ºç•…è¿ç§»**ï¼šæ ‡å‡†åŒ–çš„è¿ç§»æµç¨‹å’ŒéªŒè¯

**ğŸ’¡ å­¦ä¹ è¦ç‚¹**
```
é‡ç‚¹æŒæ¡ï¼š
1. ç‰ˆæœ¬æ§åˆ¶çš„é‡è¦æ€§å’Œå®æ–½æ–¹æ³•
2. æ‰¹é‡æ›´æ–°çš„å®‰å…¨ç­–ç•¥å’Œé£é™©æ§åˆ¶
3. æ¨¡æ¿å†²çªçš„è¯†åˆ«å’Œè§£å†³æ–¹æ³•
4. æ€§èƒ½ä¼˜åŒ–çš„ç›‘æ§æŒ‡æ ‡å’Œä¼˜åŒ–æ‰‹æ®µ
5. å¤‡ä»½æ¢å¤çš„å¤šå±‚æ¬¡ç­–ç•¥è®¾è®¡
6. è¿ç§»è¿‡ç¨‹çš„ç³»ç»ŸåŒ–ç®¡ç†æ–¹æ³•
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ¨¡æ¿ç®¡ç†é‡åœ¨è§„èŒƒï¼Œç‰ˆæœ¬æ§åˆ¶æ˜¯åŸºç¡€
- æ‰¹é‡æ“ä½œéœ€è°¨æ…ï¼Œåˆ†é˜¶æ®µæµ‹è¯•ä¿å®‰å…¨
- å†²çªé—®é¢˜è¦é¢„é˜²ï¼ŒåŠæ—¶å‘ç°å¿«è§£å†³
- æ€§èƒ½ä¼˜åŒ–æŒç»­åšï¼Œç›‘æ§æŒ‡æ ‡è¦å…³æ³¨
- å¤‡ä»½ç­–ç•¥è¦å®Œå–„ï¼Œå¤šå±‚ä¿æŠ¤ä¿å®‰å…¨
- è¿ç§»è¿‡ç¨‹è¦ç³»ç»Ÿï¼ŒéªŒè¯æµ‹è¯•ä¸å¯å°‘