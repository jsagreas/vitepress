---
title: 2ã€API-å¸¸ç”¨æ“ä½œ
---
## ğŸ“š ç›®å½•

1. [Zabbix APIåŸºç¡€è®¤çŸ¥](#1-Zabbix-APIåŸºç¡€è®¤çŸ¥)
2. [APIè®¤è¯ä¸è¿æ¥](#2-APIè®¤è¯ä¸è¿æ¥)
3. [ä¸»æœºç®¡ç†APIæ“ä½œ](#3-ä¸»æœºç®¡ç†APIæ“ä½œ)
4. [ç›‘æ§é¡¹ç®¡ç†APIæ“ä½œ](#4-ç›‘æ§é¡¹ç®¡ç†APIæ“ä½œ)
5. [è§¦å‘å™¨ç®¡ç†APIæ“ä½œ](#5-è§¦å‘å™¨ç®¡ç†APIæ“ä½œ)
6. [æ¨¡æ¿ç®¡ç†APIæ“ä½œ](#6-æ¨¡æ¿ç®¡ç†APIæ“ä½œ)
7. [ç”¨æˆ·ç®¡ç†APIæ“ä½œ](#7-ç”¨æˆ·ç®¡ç†APIæ“ä½œ)
8. [é…ç½®å¯¼å…¥å¯¼å‡ºAPIæ“ä½œ](#8-é…ç½®å¯¼å…¥å¯¼å‡ºAPIæ“ä½œ)
9. [æ‰¹é‡æ“ä½œAPIæŠ€å·§](#9-æ‰¹é‡æ“ä½œAPIæŠ€å·§)
10. [å®æˆ˜åº”ç”¨åœºæ™¯](#10-å®æˆ˜åº”ç”¨åœºæ™¯)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Zabbix APIåŸºç¡€è®¤çŸ¥


### 1.1 ä»€ä¹ˆæ˜¯Zabbix API


**ç®€å•ç†è§£**ï¼šZabbix APIå°±åƒæ˜¯ä¸€ä¸ª"ä¸‡èƒ½é¥æ§å™¨"ï¼Œè®©ä½ å¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼è¿œç¨‹æ§åˆ¶Zabbixç³»ç»Ÿï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨ç‚¹å‡»ç½‘é¡µç•Œé¢ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼šäººå·¥æ“ä½œ
ğŸ‘¨â€ğŸ’» â†’ ğŸ–±ï¸ç‚¹å‡»ç½‘é¡µ â†’ âš™ï¸é…ç½®è®¾ç½® â†’ ğŸ“ŠæŸ¥çœ‹ç»“æœ

APIæ–¹å¼ï¼šç¨‹åºæ“ä½œ  
ğŸ‘¨â€ğŸ’» â†’ ğŸ“ç¼–å†™è„šæœ¬ â†’ ğŸ”—APIè°ƒç”¨ â†’ ğŸ¤–è‡ªåŠ¨æ‰§è¡Œ â†’ ğŸ“Šæ‰¹é‡å¤„ç†
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šæ‰¹é‡æ·»åŠ æœåŠ¡å™¨ã€é…ç½®ç›‘æ§
- **æ•°æ®è·å–**ï¼šè‡ªåŠ¨æ”¶é›†ç›‘æ§æ•°æ®ã€ç”ŸæˆæŠ¥è¡¨  
- **ç³»ç»Ÿé›†æˆ**ï¼šä¸å…¶ä»–ç³»ç»Ÿå¯¹æ¥ï¼Œå®ç°ç»Ÿä¸€ç®¡ç†
- **å®šåˆ¶å¼€å‘**ï¼šå¼€å‘ä¸“å±çš„ç›‘æ§å·¥å…·å’Œç•Œé¢

### 1.2 APIçš„åŸºæœ¬å·¥ä½œåŸç†


**é€šä¿¡æ–¹å¼**ï¼šJSON-RPCåè®®ï¼ˆä¸€ç§è½»é‡çº§çš„è¿œç¨‹è°ƒç”¨åè®®ï¼‰

```
å·¥ä½œæµç¨‹ç¤ºæ„ï¼š

å®¢æˆ·ç«¯ç¨‹åº                    ZabbixæœåŠ¡å™¨
     |                            |
     |--[1]å‘é€JSONè¯·æ±‚---------->|
     |   è®¤è¯ä¿¡æ¯                  |
     |                            |--[2]éªŒè¯èº«ä»½
     |                            |--[3]æ‰§è¡Œæ“ä½œ
     |                            |--[4]è¿”å›ç»“æœ
     |<--[5]æ¥æ”¶JSONå“åº”----------|
     |   æ“ä½œç»“æœ                  |
```

### 1.3 ä¸ºä»€ä¹ˆè¦å­¦APIæ“ä½œ


**å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š

```
åœºæ™¯1ï¼šæ–°å…¥èŒ100å°æœåŠ¡å™¨
æ‰‹å·¥æ“ä½œï¼šæ¯å°æœåŠ¡å™¨å•ç‹¬é…ç½®ï¼Œéœ€è¦2-3å¤©
APIæ“ä½œï¼šç¼–å†™è„šæœ¬æ‰¹é‡é…ç½®ï¼Œ30åˆ†é’Ÿå®Œæˆ

åœºæ™¯2ï¼šæ¯æ—¥ç›‘æ§æŠ¥è¡¨
æ‰‹å·¥æ“ä½œï¼šæ¯å¤©ç™»å½•æŸ¥çœ‹ï¼Œå¯¼å‡ºæ•°æ®ï¼Œåˆ¶ä½œæŠ¥è¡¨
APIæ“ä½œï¼šè„šæœ¬è‡ªåŠ¨è·å–æ•°æ®ï¼Œç”ŸæˆæŠ¥è¡¨ï¼Œå‘é€é‚®ä»¶

åœºæ™¯3ï¼šæ•…éšœè‡ªåŠ¨å¤„ç†
æ‰‹å·¥æ“ä½œï¼šæ”¶åˆ°å‘Šè­¦â†’ç™»å½•ç³»ç»Ÿâ†’æŸ¥çœ‹è¯¦æƒ…â†’æ‰‹åŠ¨å¤„ç†
APIæ“ä½œï¼šå‘Šè­¦è§¦å‘â†’è„šæœ¬è‡ªåŠ¨åˆ†æâ†’è‡ªåŠ¨ä¿®å¤â†’è®°å½•æ—¥å¿—
```

---

## 2. ğŸ” APIè®¤è¯ä¸è¿æ¥


### 2.1 è®¤è¯æœºåˆ¶è¯¦è§£


**è®¤è¯æµç¨‹**ï¼šå°±åƒé“¶è¡Œå–é’±éœ€è¦å…ˆæ’å¡è¾“å¯†ç ä¸€æ ·ï¼Œä½¿ç”¨APIå‰éœ€è¦å…ˆ"ç™»å½•"è·å–è®¿é—®ä»¤ç‰Œã€‚

```
è®¤è¯æ­¥éª¤ï¼š
æ­¥éª¤1ï¼šå‘é€ç”¨æˆ·åå’Œå¯†ç  â†’ Zabbix
æ­¥éª¤2ï¼šZabbixéªŒè¯èº«ä»½ â†’ è¿”å›tokenä»¤ç‰Œ
æ­¥éª¤3ï¼šåç»­æ‰€æœ‰æ“ä½œéƒ½è¦æºå¸¦è¿™ä¸ªtoken
æ­¥éª¤4ï¼štokenè¿‡æœŸåéœ€è¦é‡æ–°è·å–
```

### 2.2 è·å–è®¤è¯ä»¤ç‰Œ


**Pythonç¤ºä¾‹**ï¼š
```python
import json
import requests

# APIè¿æ¥é…ç½®
ZABBIX_URL = "http://your-zabbix-server/zabbix/api_jsonrpc.php"
USERNAME = "admin"
PASSWORD = "password"

def get_auth_token():
    """è·å–è®¤è¯ä»¤ç‰Œ"""
    payload = {
        "jsonrpc": "2.0",
        "method": "user.login",
        "params": {
            "user": USERNAME,
            "password": PASSWORD
        },
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print("âœ… è®¤è¯æˆåŠŸï¼")
        return result['result']  # è¿™å°±æ˜¯ä½ çš„é€šè¡Œè¯
    else:
        print("âŒ è®¤è¯å¤±è´¥ï¼š", result.get('error'))
        return None

# è·å–ä»¤ç‰Œ
auth_token = get_auth_token()
print(f"ğŸ« è®¿é—®ä»¤ç‰Œï¼š{auth_token}")
```

### 2.3 APIè°ƒç”¨çš„é€šç”¨ç»“æ„


**è¯·æ±‚æ ¼å¼è§£æ**ï¼š
```json
{
    "jsonrpc": "2.0",           // åè®®ç‰ˆæœ¬ï¼ˆå›ºå®šå€¼ï¼‰
    "method": "æ“ä½œæ–¹æ³•å",        // ä½ è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œ
    "params": {                 // æ“ä½œå‚æ•°
        "å…·ä½“å‚æ•°": "å‚æ•°å€¼"
    },
    "auth": "è®¤è¯ä»¤ç‰Œ",          // ä½ çš„é€šè¡Œè¯
    "id": 1                     // è¯·æ±‚IDï¼ˆç”¨äºåŒ¹é…å“åº”ï¼‰
}
```

**å“åº”æ ¼å¼è§£æ**ï¼š
```json
{
    "jsonrpc": "2.0",
    "result": "æ“ä½œç»“æœ",        // æˆåŠŸæ—¶è¿”å›ç»“æœ
    "error": "é”™è¯¯ä¿¡æ¯",         // å¤±è´¥æ—¶è¿”å›é”™è¯¯
    "id": 1
}
```

---

## 3. ğŸ–¥ï¸ ä¸»æœºç®¡ç†APIæ“ä½œ


### 3.1 ä¸»æœºç›¸å…³æ ¸å¿ƒæ¦‚å¿µ


**ä¸»æœºï¼ˆHostï¼‰ç†è§£**ï¼šåœ¨Zabbixä¸­ï¼Œä¸»æœºå°±æ˜¯ä½ è¦ç›‘æ§çš„è®¾å¤‡ï¼Œå¯ä»¥æ˜¯ï¼š
- **ç‰©ç†æœåŠ¡å™¨**ï¼šçœŸå®çš„ç¡¬ä»¶è®¾å¤‡
- **è™šæ‹Ÿæœº**ï¼šäº‘ä¸»æœºã€VMwareè™šæ‹Ÿæœºç­‰
- **ç½‘ç»œè®¾å¤‡**ï¼šäº¤æ¢æœºã€è·¯ç”±å™¨ã€é˜²ç«å¢™
- **åº”ç”¨æœåŠ¡**ï¼šæ•°æ®åº“ã€WebæœåŠ¡ã€ç¼“å­˜æœåŠ¡

### 3.2 æŸ¥è¯¢ä¸»æœºä¿¡æ¯


**è·å–æ‰€æœ‰ä¸»æœºåˆ—è¡¨**ï¼š
```python
def get_all_hosts(auth_token):
    """è·å–æ‰€æœ‰ä¸»æœºä¿¡æ¯"""
    payload = {
        "jsonrpc": "2.0",
        "method": "host.get",
        "params": {
            "output": ["hostid", "host", "name", "status"],
            "selectInterfaces": ["ip", "port"],  # åŒæ—¶è·å–æ¥å£ä¿¡æ¯
            "selectGroups": ["name"]             # åŒæ—¶è·å–æ‰€å±ç»„ä¿¡æ¯
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print("ğŸ“‹ ä¸»æœºåˆ—è¡¨ï¼š")
        for host in result['result']:
            status = "ğŸŸ¢å¯ç”¨" if host['status'] == '0' else "ğŸ”´ç¦ç”¨"
            print(f"  {host['name']} ({host['host']}) - {status}")
            if host.get('interfaces'):
                print(f"    IP: {host['interfaces'][0]['ip']}")
    return result.get('result', [])
```

### 3.3 æ·»åŠ æ–°ä¸»æœº


**æ‰¹é‡æ·»åŠ ä¸»æœºçš„å®ç”¨å‡½æ•°**ï¼š
```python
def add_host(auth_token, host_name, host_ip, group_id):
    """æ·»åŠ æ–°ä¸»æœºåˆ°ç›‘æ§"""
    payload = {
        "jsonrpc": "2.0",
        "method": "host.create",
        "params": {
            "host": host_name,                    # ä¸»æœºæŠ€æœ¯åç§°
            "name": host_name,                    # ä¸»æœºæ˜¾ç¤ºåç§°
            "interfaces": [
                {
                    "type": 1,                    # 1=Zabbix agentæ¥å£
                    "main": 1,                    # ä¸»è¦æ¥å£
                    "useip": 1,                   # ä½¿ç”¨IPè¿æ¥
                    "ip": host_ip,                # IPåœ°å€
                    "dns": "",                    # DNSåç§°ï¼ˆç©ºï¼‰
                    "port": "10050"               # ç«¯å£å·
                }
            ],
            "groups": [
                {"groupid": group_id}             # ä¸»æœºç»„ID
            ]
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print(f"âœ… ä¸»æœº {host_name} æ·»åŠ æˆåŠŸï¼")
        return result['result']['hostids'][0]
    else:
        print(f"âŒ æ·»åŠ ä¸»æœºå¤±è´¥ï¼š{result.get('error')}")
        return None

# å®é™…ä½¿ç”¨ç¤ºä¾‹
new_host_id = add_host(auth_token, "web-server-01", "192.168.1.100", "2")
```

### 3.4 ä¸»æœºçŠ¶æ€ç®¡ç†


**å¯ç”¨/ç¦ç”¨ä¸»æœº**ï¼š
```python
def toggle_host_status(auth_token, host_id, enable=True):
    """å¯ç”¨æˆ–ç¦ç”¨ä¸»æœº"""
    status = 0 if enable else 1  # 0=å¯ç”¨ï¼Œ1=ç¦ç”¨
    action = "å¯ç”¨" if enable else "ç¦ç”¨"
    
    payload = {
        "jsonrpc": "2.0",
        "method": "host.update",
        "params": {
            "hostid": host_id,
            "status": status
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print(f"âœ… ä¸»æœº{action}æˆåŠŸï¼")
    else:
        print(f"âŒ ä¸»æœº{action}å¤±è´¥ï¼š{result.get('error')}")
```

---

## 4. ğŸ“Š ç›‘æ§é¡¹ç®¡ç†APIæ“ä½œ


### 4.1 ç›‘æ§é¡¹åŸºæœ¬æ¦‚å¿µ


**ç›‘æ§é¡¹ï¼ˆItemï¼‰ç†è§£**ï¼šç›‘æ§é¡¹å°±æ˜¯å…·ä½“è¦ç›‘æ§çš„æŒ‡æ ‡ï¼Œæ¯”å¦‚ï¼š
- **ç³»ç»ŸæŒ‡æ ‡**ï¼šCPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç£ç›˜ç©ºé—´
- **ç½‘ç»œæŒ‡æ ‡**ï¼šç½‘ç»œæµé‡ã€è¿æ¥æ•°ã€å»¶è¿Ÿ
- **åº”ç”¨æŒ‡æ ‡**ï¼šæ•°æ®åº“è¿æ¥æ•°ã€Webå“åº”æ—¶é—´ã€é˜Ÿåˆ—é•¿åº¦

```
ç›‘æ§é¡¹ç»“æ„ç†è§£ï¼š
ä¸»æœº (web-server-01)
â”œâ”€â”€ CPUä½¿ç”¨ç‡ (system.cpu.util)
â”œâ”€â”€ å†…å­˜ä½¿ç”¨ç‡ (vm.memory.util)
â”œâ”€â”€ ç£ç›˜ä½¿ç”¨ç‡ (vfs.fs.size[/,pused])
â””â”€â”€ ç½‘ç»œæµé‡ (net.if.in[eth0])
```

### 4.2 è·å–ç›‘æ§é¡¹ä¿¡æ¯


**æŸ¥è¯¢ä¸»æœºçš„æ‰€æœ‰ç›‘æ§é¡¹**ï¼š
```python
def get_host_items(auth_token, host_id):
    """è·å–æŒ‡å®šä¸»æœºçš„æ‰€æœ‰ç›‘æ§é¡¹"""
    payload = {
        "jsonrpc": "2.0",
        "method": "item.get",
        "params": {
            "output": ["itemid", "name", "key_", "status", "value_type"],
            "hostids": host_id,
            "monitored": True  # åªè·å–å·²å¯ç”¨çš„ç›‘æ§é¡¹
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print(f"ğŸ“ˆ ç›‘æ§é¡¹åˆ—è¡¨ï¼ˆå…±{len(result['result'])}ä¸ªï¼‰ï¼š")
        for item in result['result']:
            status = "ğŸŸ¢" if item['status'] == '0' else "ğŸ”´"
            print(f"  {status} {item['name']} ({item['key_']})")
    
    return result.get('result', [])
```

### 4.3 åˆ›å»ºç›‘æ§é¡¹


**æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹**ï¼š
```python
def create_item(auth_token, host_id, item_name, item_key, item_type=0):
    """ä¸ºä¸»æœºåˆ›å»ºæ–°çš„ç›‘æ§é¡¹"""
    payload = {
        "jsonrpc": "2.0",
        "method": "item.create",
        "params": {
            "name": item_name,                    # ç›‘æ§é¡¹æ˜¾ç¤ºåç§°
            "key_": item_key,                     # ç›‘æ§é¡¹é”®å€¼
            "hostid": host_id,                    # æ‰€å±ä¸»æœºID
            "type": item_type,                    # 0=Zabbix agent
            "value_type": 3,                      # 3=æ•°å­—ï¼ˆæµ®ç‚¹æ•°ï¼‰
            "delay": "30s",                       # æ£€æŸ¥é—´éš”
            "history": "7d",                      # å†å²æ•°æ®ä¿å­˜æ—¶é—´
            "trends": "365d"                      # è¶‹åŠ¿æ•°æ®ä¿å­˜æ—¶é—´
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print(f"âœ… ç›‘æ§é¡¹ '{item_name}' åˆ›å»ºæˆåŠŸï¼")
        return result['result']['itemids'][0]
    else:
        print(f"âŒ åˆ›å»ºç›‘æ§é¡¹å¤±è´¥ï¼š{result.get('error')}")
        return None

# ä½¿ç”¨ç¤ºä¾‹ï¼šæ·»åŠ CPUä½¿ç”¨ç‡ç›‘æ§
cpu_item_id = create_item(
    auth_token, 
    host_id="10084", 
    item_name="CPUä½¿ç”¨ç‡", 
    item_key="system.cpu.util"
)
```

### 4.4 ç›‘æ§é¡¹æ•°æ®ç±»å‹è¯´æ˜


| **æ•°æ®ç±»å‹** | **å€¼** | **è¯´æ˜** | **é€‚ç”¨åœºæ™¯** |
|------------|------|---------|------------|
| **æµ®ç‚¹æ•°** | `3` | å¯å¸¦å°æ•°çš„æ•°å­— | CPUä½¿ç”¨ç‡ã€æ¸©åº¦ |
| **å­—ç¬¦** | `4` | æ–‡æœ¬å­—ç¬¦ä¸² | ç‰ˆæœ¬ä¿¡æ¯ã€çŠ¶æ€ |
| **æ—¥å¿—** | `2` | æ—¥å¿—æ–‡ä»¶å†…å®¹ | ç³»ç»Ÿæ—¥å¿—åˆ†æ |
| **æ— ç¬¦å·æ•´æ•°** | `0` | æ­£æ•´æ•° | å†…å­˜å¤§å°ã€è¿æ¥æ•° |
| **æ–‡æœ¬** | `1` | å¤§æ®µæ–‡æœ¬ | é…ç½®æ–‡ä»¶å†…å®¹ |

---

## 5. ğŸš¨ è§¦å‘å™¨ç®¡ç†APIæ“ä½œ


### 5.1 è§¦å‘å™¨æ¦‚å¿µç†è§£


**è§¦å‘å™¨ï¼ˆTriggerï¼‰**ï¼šè§¦å‘å™¨å°±åƒæ˜¯"ç›‘æ§çš„å¤§è„‘"ï¼Œå®ƒä¼šåˆ†æç›‘æ§æ•°æ®ï¼Œå½“å‘ç°å¼‚å¸¸æ—¶å°±"æ‹‰å“è­¦æŠ¥"ã€‚

```
è§¦å‘å™¨å·¥ä½œåŸç†ï¼š
ç›‘æ§é¡¹æ”¶é›†æ•°æ® â†’ è§¦å‘å™¨åˆ†ææ•°æ® â†’ æ¡ä»¶æ»¡è¶³ â†’ äº§ç”Ÿå‘Šè­¦

å®é™…ä¾‹å­ï¼š
CPUä½¿ç”¨ç‡ç›‘æ§é¡¹ â†’ CPU > 80%è§¦å‘å™¨ â†’ æŒç»­5åˆ†é’Ÿ â†’ å‘é€å‘Šè­¦é‚®ä»¶
```

### 5.2 æŸ¥è¯¢è§¦å‘å™¨ä¿¡æ¯


**è·å–ä¸»æœºçš„æ‰€æœ‰è§¦å‘å™¨**ï¼š
```python
def get_host_triggers(auth_token, host_id):
    """è·å–æŒ‡å®šä¸»æœºçš„æ‰€æœ‰è§¦å‘å™¨"""
    payload = {
        "jsonrpc": "2.0",
        "method": "trigger.get",
        "params": {
            "output": ["triggerid", "description", "expression", "priority"],
            "hostids": host_id,
            "expandExpression": True,  # å±•å¼€è¡¨è¾¾å¼ä¸ºå¯è¯»æ ¼å¼
            "selectItems": ["name", "key_"]  # åŒæ—¶è·å–ç›¸å…³ç›‘æ§é¡¹
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print("ğŸš¨ è§¦å‘å™¨åˆ—è¡¨ï¼š")
        for trigger in result['result']:
            # ä¸¥é‡ç¨‹åº¦è½¬æ¢
            priority_map = {
                '0': 'ğŸ”µæœªåˆ†ç±»', '1': 'ğŸŸ¢ä¿¡æ¯', '2': 'ğŸŸ¡è­¦å‘Š',
                '3': 'ğŸŸ ä¸€èˆ¬ä¸¥é‡', '4': 'ğŸ”´ä¸¥é‡', '5': 'ğŸŸ£ç¾éš¾'
            }
            severity = priority_map.get(trigger['priority'], 'æœªçŸ¥')
            print(f"  {severity} {trigger['description']}")
            print(f"    è¡¨è¾¾å¼ï¼š{trigger['expression']}")
    
    return result.get('result', [])
```

### 5.3 åˆ›å»ºè§¦å‘å™¨


**åˆ›å»ºCPUä½¿ç”¨ç‡å‘Šè­¦è§¦å‘å™¨**ï¼š
```python
def create_cpu_trigger(auth_token, host_id, item_id):
    """åˆ›å»ºCPUä½¿ç”¨ç‡å‘Šè­¦è§¦å‘å™¨"""
    payload = {
        "jsonrpc": "2.0",
        "method": "trigger.create",
        "params": {
            "description": "CPUä½¿ç”¨ç‡è¿‡é«˜å‘Šè­¦",
            "expression": f"{{host:system.cpu.util.avg(5m)}}>80",  # 5åˆ†é’Ÿå¹³å‡å€¼>80%
            "priority": 3,                        # ä¸€èˆ¬ä¸¥é‡
            "status": 0,                          # å¯ç”¨çŠ¶æ€
            "comments": "å½“CPUä½¿ç”¨ç‡è¿ç»­5åˆ†é’Ÿè¶…è¿‡80%æ—¶è§¦å‘å‘Šè­¦"
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print("âœ… CPUå‘Šè­¦è§¦å‘å™¨åˆ›å»ºæˆåŠŸï¼")
        return result['result']['triggerids'][0]
    else:
        print(f"âŒ åˆ›å»ºè§¦å‘å™¨å¤±è´¥ï¼š{result.get('error')}")
        return None
```

### 5.4 è§¦å‘å™¨è¡¨è¾¾å¼è¯¦è§£


**å¸¸ç”¨è¡¨è¾¾å¼æ¨¡æ¿**ï¼š

| **ç›‘æ§åœºæ™¯** | **è¡¨è¾¾å¼ç¤ºä¾‹** | **è¯´æ˜** |
|------------|---------------|---------|
| **CPUå‘Šè­¦** | `{host:system.cpu.util.avg(5m)}>80` | 5åˆ†é’Ÿå¹³å‡CPUè¶…è¿‡80% |
| **å†…å­˜å‘Šè­¦** | `{host:vm.memory.util.last()}>90` | å½“å‰å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90% |
| **ç£ç›˜å‘Šè­¦** | `{host:vfs.fs.size[/,pused].last()}>85` | æ ¹åˆ†åŒºä½¿ç”¨ç‡è¶…è¿‡85% |
| **æœåŠ¡å¼‚å¸¸** | `{host:net.tcp.service[http].last()}=0` | HTTPæœåŠ¡ä¸å¯ç”¨ |

---

## 6. ğŸ“‹ æ¨¡æ¿ç®¡ç†APIæ“ä½œ


### 6.1 æ¨¡æ¿æ¦‚å¿µç†è§£


**æ¨¡æ¿ï¼ˆTemplateï¼‰**ï¼šæ¨¡æ¿å°±åƒæ˜¯"ç›‘æ§é…ç½®çš„æ¨¡å…·"ï¼Œå®šä¹‰å¥½ä¸€å¥—ç›‘æ§æ–¹æ¡ˆåï¼Œå¯ä»¥æ‰¹é‡åº”ç”¨åˆ°å¤šå°ç›¸ä¼¼çš„æœåŠ¡å™¨ä¸Šã€‚

```
æ¨¡æ¿çš„ä½œç”¨ï¼š
æ ‡å‡†åŒ– â†’ é¿å…é‡å¤é…ç½®
æ‰¹é‡åŒ– â†’ å¿«é€Ÿéƒ¨ç½²ç›‘æ§
è§„èŒƒåŒ– â†’ ç»Ÿä¸€ç›‘æ§æ ‡å‡†

ä¸¾ä¾‹ï¼š
LinuxæœåŠ¡å™¨æ¨¡æ¿ åŒ…å«ï¼š
â”œâ”€â”€ CPUç›‘æ§é¡¹
â”œâ”€â”€ å†…å­˜ç›‘æ§é¡¹  
â”œâ”€â”€ ç£ç›˜ç›‘æ§é¡¹
â”œâ”€â”€ å¯¹åº”çš„å‘Šè­¦è§„åˆ™
â””â”€â”€ å¯ä»¥åº”ç”¨åˆ°100å°LinuxæœåŠ¡å™¨
```

### 6.2 è·å–æ¨¡æ¿ä¿¡æ¯


**æŸ¥è¯¢æ‰€æœ‰å¯ç”¨æ¨¡æ¿**ï¼š
```python
def get_templates(auth_token):
    """è·å–æ‰€æœ‰æ¨¡æ¿åˆ—è¡¨"""
    payload = {
        "jsonrpc": "2.0",
        "method": "template.get",
        "params": {
            "output": ["templateid", "host", "name"],
            "selectItems": "count",        # ç»Ÿè®¡ç›‘æ§é¡¹æ•°é‡
            "selectTriggers": "count"      # ç»Ÿè®¡è§¦å‘å™¨æ•°é‡
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print("ğŸ“‹ å¯ç”¨æ¨¡æ¿åˆ—è¡¨ï¼š")
        for template in result['result']:
            print(f"  ğŸ“„ {template['name']}")
            print(f"     ç›‘æ§é¡¹ï¼š{template['items']}ä¸ª | è§¦å‘å™¨ï¼š{template['triggers']}ä¸ª")
    
    return result.get('result', [])
```

### 6.3 åº”ç”¨æ¨¡æ¿åˆ°ä¸»æœº


**ä¸ºä¸»æœºåº”ç”¨ç›‘æ§æ¨¡æ¿**ï¼š
```python
def apply_template_to_host(auth_token, host_id, template_id):
    """ä¸ºä¸»æœºåº”ç”¨æŒ‡å®šæ¨¡æ¿"""
    # é¦–å…ˆè·å–ä¸»æœºå½“å‰çš„æ¨¡æ¿
    get_payload = {
        "jsonrpc": "2.0",
        "method": "host.get",
        "params": {
            "hostids": host_id,
            "selectParentTemplates": ["templateid"]
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(get_payload),
                           headers={'Content-Type': 'application/json'})
    
    current_templates = response.json()['result'][0]['parentTemplates']
    current_template_ids = [t['templateid'] for t in current_templates]
    
    # æ·»åŠ æ–°æ¨¡æ¿ï¼ˆä¿ç•™ç°æœ‰æ¨¡æ¿ï¼‰
    all_templates = [{"templateid": tid} for tid in current_template_ids + [template_id]]
    
    update_payload = {
        "jsonrpc": "2.0",
        "method": "host.update",
        "params": {
            "hostid": host_id,
            "templates": all_templates
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(update_payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print("âœ… æ¨¡æ¿åº”ç”¨æˆåŠŸï¼")
    else:
        print(f"âŒ æ¨¡æ¿åº”ç”¨å¤±è´¥ï¼š{result.get('error')}")
```

---

## 7. ğŸ‘¥ ç”¨æˆ·ç®¡ç†APIæ“ä½œ


### 7.1 ç”¨æˆ·ç®¡ç†åŸºç¡€æ¦‚å¿µ


**ç”¨æˆ·ç±»å‹ç†è§£**ï¼š
- **Zabbixè¶…çº§ç®¡ç†å‘˜**ï¼šæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œå¯ä»¥é…ç½®ä¸€åˆ‡
- **Zabbixç®¡ç†å‘˜**ï¼šå¯ä»¥ç®¡ç†é…ç½®ï¼Œä½†ä¸èƒ½ç®¡ç†å…¶ä»–ç”¨æˆ·
- **Zabbixç”¨æˆ·**ï¼šåªèƒ½æŸ¥çœ‹è¢«æˆæƒçš„ç›‘æ§æ•°æ®

```
æƒé™å±‚çº§ï¼š
è¶…çº§ç®¡ç†å‘˜
    â”œâ”€â”€ ç³»ç»Ÿé…ç½®
    â”œâ”€â”€ ç”¨æˆ·ç®¡ç†
    â”œâ”€â”€ æ‰€æœ‰ç›‘æ§æ•°æ®
    â””â”€â”€ APIè®¿é—®æƒé™

ç®¡ç†å‘˜
    â”œâ”€â”€ ä¸»æœºé…ç½®
    â”œâ”€â”€ ç›‘æ§é…ç½®
    â””â”€â”€ è¢«æˆæƒçš„æ•°æ®

æ™®é€šç”¨æˆ·
    â””â”€â”€ åªè¯»æŸ¥çœ‹æƒé™
```

### 7.2 è·å–ç”¨æˆ·ä¿¡æ¯


**æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·**ï¼š
```python
def get_users(auth_token):
    """è·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯"""
    payload = {
        "jsonrpc": "2.0",
        "method": "user.get",
        "params": {
            "output": ["userid", "alias", "name", "surname", "type"],
            "selectUsrgrps": ["name"]  # è·å–ç”¨æˆ·ç»„ä¿¡æ¯
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print("ğŸ‘¥ ç”¨æˆ·åˆ—è¡¨ï¼š")
        for user in result['result']:
            # ç”¨æˆ·ç±»å‹è½¬æ¢
            user_types = {
                '1': 'ğŸ‘¤æ™®é€šç”¨æˆ·', 
                '2': 'ğŸ‘¨â€ğŸ’¼ç®¡ç†å‘˜', 
                '3': 'ğŸ‘‘è¶…çº§ç®¡ç†å‘˜'
            }
            user_type = user_types.get(user['type'], 'æœªçŸ¥')
            full_name = f"{user['name']} {user['surname']}".strip()
            
            print(f"  {user_type} {user['alias']} ({full_name})")
            if user.get('usrgrps'):
                groups = [g['name'] for g in user['usrgrps']]
                print(f"    æ‰€å±ç»„ï¼š{', '.join(groups)}")
    
    return result.get('result', [])
```

### 7.3 åˆ›å»ºæ–°ç”¨æˆ·


**æ‰¹é‡åˆ›å»ºç›‘æ§ç”¨æˆ·**ï¼š
```python
def create_user(auth_token, username, password, full_name, user_type=1):
    """åˆ›å»ºæ–°ç”¨æˆ·"""
    name_parts = full_name.split(' ', 1)
    first_name = name_parts[0]
    last_name = name_parts[1] if len(name_parts) > 1 else ""
    
    payload = {
        "jsonrpc": "2.0",
        "method": "user.create",
        "params": {
            "alias": username,
            "passwd": password,
            "name": first_name,
            "surname": last_name,
            "type": user_type,               # 1=ç”¨æˆ·ï¼Œ2=ç®¡ç†å‘˜ï¼Œ3=è¶…çº§ç®¡ç†å‘˜
            "usrgrps": [
                {"usrgroupid": "7"}          # é»˜è®¤ç”¨æˆ·ç»„
            ]
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print(f"âœ… ç”¨æˆ· {username} åˆ›å»ºæˆåŠŸï¼")
        return result['result']['userids'][0]
    else:
        print(f"âŒ åˆ›å»ºç”¨æˆ·å¤±è´¥ï¼š{result.get('error')}")
        return None

# æ‰¹é‡åˆ›å»ºç”¨æˆ·ç¤ºä¾‹
users_to_create = [
    ("monitor_user1", "password123", "å¼ ä¸‰", 1),
    ("monitor_admin", "admin123", "æå››", 2)
]

for username, password, name, user_type in users_to_create:
    create_user(auth_token, username, password, name, user_type)
```

---

## 8. ğŸ“¦ é…ç½®å¯¼å…¥å¯¼å‡ºAPIæ“ä½œ


### 8.1 é…ç½®å¯¼å…¥å¯¼å‡ºæ¦‚å¿µ


**ä¸ºä»€ä¹ˆéœ€è¦å¯¼å…¥å¯¼å‡º**ï¼š
- **å¤‡ä»½é…ç½®**ï¼šé˜²æ­¢é…ç½®ä¸¢å¤±ï¼Œä¾¿äºæ¢å¤
- **ç¯å¢ƒè¿ç§»**ï¼šä»æµ‹è¯•ç¯å¢ƒç§»æ¤åˆ°ç”Ÿäº§ç¯å¢ƒ
- **é…ç½®å…±äº«**ï¼šåœ¨ä¸åŒZabbixå®ä¾‹é—´å…±äº«é…ç½®
- **ç‰ˆæœ¬ç®¡ç†**ï¼šè¿½è¸ªé…ç½®å˜æ›´å†å²

```
é…ç½®å¯¼å‡ºåœºæ™¯ï¼š
å¼€å‘ç¯å¢ƒ â†’ å¯¼å‡ºé…ç½® â†’ æµ‹è¯•ç¯å¢ƒ â†’ å¯¼å‡ºé…ç½® â†’ ç”Ÿäº§ç¯å¢ƒ

é…ç½®ç±»å‹ï¼š
â”œâ”€â”€ ä¸»æœºé…ç½®
â”œâ”€â”€ æ¨¡æ¿é…ç½®
â”œâ”€â”€ ç›‘æ§é¡¹é…ç½®
â”œâ”€â”€ è§¦å‘å™¨é…ç½®
â””â”€â”€ ç”¨æˆ·ç»„é…ç½®
```

### 8.2 å¯¼å‡ºé…ç½®


**å¯¼å‡ºä¸»æœºé…ç½®**ï¼š
```python
def export_hosts(auth_token, host_ids, export_format="json"):
    """å¯¼å‡ºæŒ‡å®šä¸»æœºçš„é…ç½®"""
    payload = {
        "jsonrpc": "2.0",
        "method": "configuration.export",
        "params": {
            "format": export_format,         # json æˆ– xml
            "options": {
                "hosts": host_ids
            }
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        # ä¿å­˜åˆ°æ–‡ä»¶
        filename = f"host_config_export_{len(host_ids)}hosts.json"
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(result['result'])
        
        print(f"âœ… é…ç½®å·²å¯¼å‡ºåˆ°æ–‡ä»¶ï¼š{filename}")
        print(f"ğŸ“Š å¯¼å‡ºäº† {len(host_ids)} å°ä¸»æœºçš„é…ç½®")
        return filename
    else:
        print(f"âŒ å¯¼å‡ºå¤±è´¥ï¼š{result.get('error')}")
        return None

# ä½¿ç”¨ç¤ºä¾‹ï¼šå¯¼å‡ºç‰¹å®šä¸»æœº
host_ids_to_export = ["10084", "10085", "10086"]
export_file = export_hosts(auth_token, host_ids_to_export)
```

**å¯¼å‡ºæ¨¡æ¿é…ç½®**ï¼š
```python
def export_templates(auth_token, template_ids):
    """å¯¼å‡ºæ¨¡æ¿é…ç½®"""
    payload = {
        "jsonrpc": "2.0",
        "method": "configuration.export",
        "params": {
            "format": "json",
            "options": {
                "templates": template_ids
            }
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        filename = f"template_export_{len(template_ids)}templates.json"
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(result['result'])
        
        print(f"âœ… æ¨¡æ¿é…ç½®å·²å¯¼å‡ºï¼š{filename}")
        return filename
    else:
        print(f"âŒ æ¨¡æ¿å¯¼å‡ºå¤±è´¥ï¼š{result.get('error')}")
        return None
```

### 8.3 å¯¼å…¥é…ç½®


**å¯¼å…¥é…ç½®æ–‡ä»¶**ï¼š
```python
def import_configuration(auth_token, config_file, import_rules=None):
    """å¯¼å…¥é…ç½®æ–‡ä»¶"""
    # é»˜è®¤å¯¼å…¥è§„åˆ™
    if import_rules is None:
        import_rules = {
            "hosts": {
                "createMissing": True,       # åˆ›å»ºä¸å­˜åœ¨çš„ä¸»æœº
                "updateExisting": True       # æ›´æ–°å·²å­˜åœ¨çš„ä¸»æœº
            },
            "templates": {
                "createMissing": True,
                "updateExisting": True
            },
            "items": {
                "createMissing": True,
                "updateExisting": True
            },
            "triggers": {
                "createMissing": True,
                "updateExisting": True
            }
        }
    
    # è¯»å–é…ç½®æ–‡ä»¶
    with open(config_file, 'r', encoding='utf-8') as f:
        config_data = f.read()
    
    payload = {
        "jsonrpc": "2.0",
        "method": "configuration.import",
        "params": {
            "format": "json",
            "source": config_data,
            "rules": import_rules
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(payload),
                           headers={'Content-Type': 'application/json'})
    
    result = response.json()
    if 'result' in result:
        print("âœ… é…ç½®å¯¼å…¥æˆåŠŸï¼")
        if result['result']:  # å¦‚æœæœ‰è¿”å›è¯¦ç»†ç»“æœ
            print(f"ğŸ“Š å¯¼å…¥ç»“æœï¼š{result['result']}")
    else:
        print(f"âŒ é…ç½®å¯¼å…¥å¤±è´¥ï¼š{result.get('error')}")

# ä½¿ç”¨ç¤ºä¾‹
import_configuration(auth_token, "host_config_export_3hosts.json")
```

---

## 9. ğŸ”„ æ‰¹é‡æ“ä½œAPIæŠ€å·§


### 9.1 æ‰¹é‡æ“ä½œçš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦æ‰¹é‡æ“ä½œ**ï¼š
- **æé«˜æ•ˆç‡**ï¼šä¸€æ¬¡æ€§å¤„ç†å¤§é‡å¯¹è±¡
- **ä¿è¯ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„é…ç½®æ ‡å‡†
- **å‡å°‘é”™è¯¯**ï¼šé¿å…æ‰‹å·¥æ“ä½œçš„å¤±è¯¯
- **èŠ‚çœæ—¶é—´**ï¼šè‡ªåŠ¨åŒ–æ›¿ä»£äººå·¥é‡å¤åŠ³åŠ¨

### 9.2 æ‰¹é‡ä¸»æœºæ“ä½œ


**æ‰¹é‡æ·»åŠ æœåŠ¡å™¨ç›‘æ§**ï¼š
```python
def batch_add_hosts(auth_token, host_configs):
    """æ‰¹é‡æ·»åŠ ä¸»æœº"""
    success_count = 0
    fail_count = 0
    
    print(f"ğŸš€ å¼€å§‹æ‰¹é‡æ·»åŠ  {len(host_configs)} å°ä¸»æœº...")
    
    for config in host_configs:
        host_name = config['name']
        host_ip = config['ip']
        group_id = config.get('group_id', '2')  # é»˜è®¤LinuxæœåŠ¡å™¨ç»„
        
        print(f"  ğŸ“ æ­£åœ¨æ·»åŠ ï¼š{host_name} ({host_ip})")
        
        payload = {
            "jsonrpc": "2.0",
            "method": "host.create",
            "params": {
                "host": host_name,
                "name": host_name,
                "interfaces": [
                    {
                        "type": 1,
                        "main": 1,
                        "useip": 1,
                        "ip": host_ip,
                        "dns": "",
                        "port": "10050"
                    }
                ],
                "groups": [{"groupid": group_id}],
                "templates": [
                    {"templateid": "10001"}  # åº”ç”¨é»˜è®¤æ¨¡æ¿
                ]
            },
            "auth": auth_token,
            "id": 1
        }
        
        try:
            response = requests.post(ZABBIX_URL, 
                                   data=json.dumps(payload),
                                   headers={'Content-Type': 'application/json'},
                                   timeout=30)
            
            result = response.json()
            if 'result' in result:
                print(f"    âœ… {host_name} æ·»åŠ æˆåŠŸ")
                success_count += 1
            else:
                print(f"    âŒ {host_name} æ·»åŠ å¤±è´¥ï¼š{result.get('error', {}).get('data', 'æœªçŸ¥é”™è¯¯')}")
                fail_count += 1
                
        except Exception as e:
            print(f"    âŒ {host_name} ç½‘ç»œé”™è¯¯ï¼š{str(e)}")
            fail_count += 1
    
    print(f"\nğŸ“Š æ‰¹é‡æ·»åŠ å®Œæˆï¼šæˆåŠŸ {success_count} å°ï¼Œå¤±è´¥ {fail_count} å°")
    return success_count, fail_count

# ä½¿ç”¨ç¤ºä¾‹ï¼šæ‰¹é‡æ·»åŠ æœåŠ¡å™¨
servers_to_add = [
    {"name": "web-server-01", "ip": "192.168.1.10", "group_id": "2"},
    {"name": "web-server-02", "ip": "192.168.1.11", "group_id": "2"},
    {"name": "db-server-01", "ip": "192.168.1.20", "group_id": "3"},
    {"name": "cache-server-01", "ip": "192.168.1.30", "group_id": "4"}
]

batch_add_hosts(auth_token, servers_to_add)
```

### 9.3 æ‰¹é‡çŠ¶æ€ç®¡ç†


**æ‰¹é‡å¯ç”¨/ç¦ç”¨ä¸»æœº**ï¼š
```python
def batch_toggle_hosts(auth_token, host_names, enable=True):
    """æ‰¹é‡å¯ç”¨æˆ–ç¦ç”¨ä¸»æœº"""
    action = "å¯ç”¨" if enable else "ç¦ç”¨"
    status = 0 if enable else 1
    
    # é¦–å…ˆæ ¹æ®ä¸»æœºåè·å–ä¸»æœºID
    get_hosts_payload = {
        "jsonrpc": "2.0",
        "method": "host.get",
        "params": {
            "output": ["hostid", "host", "name"],
            "filter": {
                "host": host_names
            }
        },
        "auth": auth_token,
        "id": 1
    }
    
    response = requests.post(ZABBIX_URL, 
                           data=json.dumps(get_hosts_payload),
                           headers={'Content-Type': 'application/json'})
    
    hosts = response.json().get('result', [])
    
    if not hosts:
        print("âŒ æœªæ‰¾åˆ°æŒ‡å®šçš„ä¸»æœº")
        return
    
    print(f"ğŸ”„ å¼€å§‹æ‰¹é‡{action}ä¸»æœº...")
    success_count = 0
    
    for host in hosts:
        update_payload = {
            "jsonrpc": "2.0",
            "method": "host.update",
            "params": {
                "hostid": host['hostid'],
                "status": status
            },
            "auth": auth_token,
            "id": 1
        }
        
        response = requests.post(ZABBIX_URL, 
                               data=json.dumps(update_payload),
                               headers={'Content-Type': 'application/json'})
        
        result = response.json()
        if 'result' in result:
            print(f"  âœ… {host['name']} {action}æˆåŠŸ")
            success_count += 1
        else:
            print(f"  âŒ {host['name']} {action}å¤±è´¥")
    
    print(f"ğŸ“Š æ‰¹é‡{action}å®Œæˆï¼šæˆåŠŸ {success_count}/{len(hosts)} å°ä¸»æœº")

# ä½¿ç”¨ç¤ºä¾‹ï¼šæ‰¹é‡ç¦ç”¨æµ‹è¯•æœåŠ¡å™¨
test_servers = ["test-web-01", "test-web-02", "test-db-01"]
batch_toggle_hosts(auth_token, test_servers, enable=False)
```

---

## 10. ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯


### 10.1 è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬


**æ–°æœåŠ¡å™¨ä¸Šçº¿è‡ªåŠ¨åŒ–è„šæœ¬**ï¼š
```python
def auto_server_onboarding(auth_token, server_info):
    """æ–°æœåŠ¡å™¨è‡ªåŠ¨ä¸Šçº¿ç›‘æ§"""
    print(f"ğŸš€ å¼€å§‹è‡ªåŠ¨åŒ–éƒ¨ç½²æœåŠ¡å™¨ç›‘æ§ï¼š{server_info['name']}")
    
    # æ­¥éª¤1ï¼šæ·»åŠ ä¸»æœº
    print("  ğŸ“ 1. æ·»åŠ ä¸»æœºåˆ°ç›‘æ§...")
    host_id = add_host(
        auth_token, 
        server_info['name'], 
        server_info['ip'], 
        server_info['group_id']
    )
    
    if not host_id:
        print("âŒ ä¸»æœºæ·»åŠ å¤±è´¥ï¼Œåœæ­¢åç»­æ“ä½œ")
        return False
    
    # æ­¥éª¤2ï¼šåº”ç”¨æ¨¡æ¿
    print("  ğŸ“‹ 2. åº”ç”¨ç›‘æ§æ¨¡æ¿...")
    for template_id in server_info.get('template_ids', []):
        apply_template_to_host(auth_token, host_id, template_id)
    
    # æ­¥éª¤3ï¼šåˆ›å»ºè‡ªå®šä¹‰ç›‘æ§é¡¹
    print("  ğŸ“Š 3. åˆ›å»ºè‡ªå®šä¹‰ç›‘æ§é¡¹...")
    if 'custom_items' in server_info:
        for item in server_info['custom_items']:
            create_item(
                auth_token, 
                host_id, 
                item['name'], 
                item['key']
            )
    
    # æ­¥éª¤4ï¼šåˆ›å»ºå‘Šè­¦è§„åˆ™
    print("  ğŸš¨ 4. åˆ›å»ºå‘Šè­¦è§„åˆ™...")
    if server_info.get('create_cpu_alert', True):
        create_cpu_trigger(auth_token, host_id, None)
    
    print(f"âœ… æœåŠ¡å™¨ {server_info['name']} ç›‘æ§éƒ¨ç½²å®Œæˆï¼")
    return True

# ä½¿ç”¨ç¤ºä¾‹ï¼šæ‰¹é‡éƒ¨ç½²æ–°æœåŠ¡å™¨ç›‘æ§
new_servers = [
    {
        "name": "prod-web-01",
        "ip": "10.0.1.100",
        "group_id": "2",
        "template_ids": ["10001", "10047"],  # Linux + Nginxæ¨¡æ¿
        "custom_items": [
            {"name": "åº”ç”¨è¿›ç¨‹æ•°", "key": "proc.num[nginx]"}
        ],
        "create_cpu_alert": True
    },
    {
        "name": "prod-db-01", 
        "ip": "10.0.1.200",
        "group_id": "3",
        "template_ids": ["10001", "10052"],  # Linux + MySQLæ¨¡æ¿
        "create_cpu_alert": True
    }
]

for server in new_servers:
    auto_server_onboarding(auth_token, server)
```

### 10.2 ç›‘æ§æ•°æ®æŠ¥è¡¨ç”Ÿæˆ


**è‡ªåŠ¨ç”Ÿæˆå‘¨æŠ¥**ï¼š
```python
def generate_weekly_report(auth_token, start_date, end_date):
    """ç”Ÿæˆç›‘æ§å‘¨æŠ¥"""
    print("ğŸ“Š æ­£åœ¨ç”Ÿæˆç›‘æ§å‘¨æŠ¥...")
    
    # è·å–æ‰€æœ‰ä¸»æœº
    hosts = get_all_hosts(auth_token)
    
    report_data = {
        "report_period": f"{start_date} è‡³ {end_date}",
        "total_hosts": len(hosts),
        "active_hosts": 0,
        "inactive_hosts": 0,
        "alert_summary": {},
        "top_issues": []
    }
    
    # ç»Ÿè®¡ä¸»æœºçŠ¶æ€
    for host in hosts:
        if host['status'] == '0':
            report_data['active_hosts'] += 1
        else:
            report_data['inactive_hosts'] += 1
    
    # è·å–å‘Šè­¦ç»Ÿè®¡ï¼ˆè¿™é‡Œç®€åŒ–å±•ç¤ºï¼‰
    print("  ğŸ” åˆ†æå‘Šè­¦æ•°æ®...")
    # å®é™…å®ç°ä¸­ä¼šè°ƒç”¨problem.getæ–¹æ³•è·å–é—®é¢˜æ•°æ®
    
    # ç”ŸæˆæŠ¥è¡¨æ–‡ä»¶
    report_filename = f"monitoring_report_{start_date}_to_{end_date}.txt"
    with open(report_filename, 'w', encoding='utf-8') as f:
        f.write("="*50 + "\n")
        f.write("Zabbix ç›‘æ§å‘¨æŠ¥\n")
        f.write("="*50 + "\n")
        f.write(f"æŠ¥å‘Šå‘¨æœŸï¼š{report_data['report_period']}\n")
        f.write(f"ä¸»æœºæ€»æ•°ï¼š{report_data['total_hosts']}\n")
        f.write(f"  - æ´»è·ƒä¸»æœºï¼š{report_data['active_hosts']}\n")
        f.write(f"  - ç¦ç”¨ä¸»æœºï¼š{report_data['inactive_hosts']}\n")
        f.write("="*50 + "\n")
    
    print(f"âœ… å‘¨æŠ¥å·²ç”Ÿæˆï¼š{report_filename}")
    return report_filename

# ç”Ÿæˆæœ¬å‘¨æŠ¥è¡¨
import datetime
today = datetime.date.today()
week_ago = today - datetime.timedelta(days=7)
generate_weekly_report(auth_token, week_ago.strftime('%Y-%m-%d'), today.strftime('%Y-%m-%d'))
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ APIæœ¬è´¨ï¼šé€šè¿‡ç¼–ç¨‹æ–¹å¼è¿œç¨‹æ§åˆ¶Zabbixï¼Œå®ç°è‡ªåŠ¨åŒ–ç®¡ç†
ğŸ”¸ è®¤è¯æœºåˆ¶ï¼šå…ˆç™»å½•è·å–tokenï¼Œåç»­æ“ä½œéƒ½è¦æºå¸¦token
ğŸ”¸ JSON-RPCï¼šç»Ÿä¸€çš„è¯·æ±‚å“åº”æ ¼å¼ï¼Œmethod+params+authç»“æ„
ğŸ”¸ å¯¹è±¡å…³ç³»ï¼šä¸»æœºâ†’ç›‘æ§é¡¹â†’è§¦å‘å™¨â†’å‘Šè­¦çš„å±‚æ¬¡å…³ç³»
ğŸ”¸ æ‰¹é‡æ“ä½œï¼šæé«˜æ•ˆç‡çš„å…³é”®ï¼Œå¾ªç¯è°ƒç”¨APIå®ç°æ‰¹é‡å¤„ç†
```

### 11.2 APIæ“ä½œæ ¸å¿ƒæŠ€èƒ½


**ğŸ”¹ åŸºç¡€æ“ä½œæŒæ¡**
```
ä¸»æœºç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥ä¸»æœºï¼ŒçŠ¶æ€æ§åˆ¶
ç›‘æ§é¡¹ç®¡ç†ï¼šåˆ›å»ºç›‘æ§é¡¹ï¼Œè®¾ç½®é‡‡é›†é—´éš”
è§¦å‘å™¨ç®¡ç†ï¼šè®¾ç½®å‘Šè­¦æ¡ä»¶ï¼Œå®šä¹‰ä¸¥é‡ç¨‹åº¦
æ¨¡æ¿ç®¡ç†ï¼šæ ‡å‡†åŒ–é…ç½®ï¼Œæ‰¹é‡åº”ç”¨
ç”¨æˆ·ç®¡ç†ï¼šæƒé™åˆ†é…ï¼Œè´¦æˆ·ç»´æŠ¤
```

**ğŸ”¹ é«˜çº§æ“ä½œæŠ€å·§**
```
é…ç½®å¯¼å…¥å¯¼å‡ºï¼šç¯å¢ƒè¿ç§»ï¼Œé…ç½®å¤‡ä»½
æ‰¹é‡æ“ä½œï¼šæé«˜è¿ç»´æ•ˆç‡ï¼Œå‡å°‘é‡å¤å·¥ä½œ
é”™è¯¯å¤„ç†ï¼šå¼‚å¸¸æ•è·ï¼Œå¤±è´¥é‡è¯•
æ—¥å¿—è®°å½•ï¼šæ“ä½œå®¡è®¡ï¼Œé—®é¢˜æ’æŸ¥
```

### 11.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ è¿ç»´è‡ªåŠ¨åŒ–åœºæ™¯**
- **æ–°æœåŠ¡å™¨ä¸Šçº¿**ï¼šè‡ªåŠ¨æ·»åŠ ç›‘æ§ï¼Œåº”ç”¨æ ‡å‡†æ¨¡æ¿
- **æ‰¹é‡é…ç½®å˜æ›´**ï¼šç»Ÿä¸€ä¿®æ”¹å‘Šè­¦é˜ˆå€¼ï¼Œæ›´æ–°ç›‘æ§å‚æ•°
- **ç¯å¢ƒè¿ç§»**ï¼šæµ‹è¯•é…ç½®æ¨å¹¿åˆ°ç”Ÿäº§ç¯å¢ƒ
- **æŠ¥è¡¨ç”Ÿæˆ**ï¼šå®šæœŸç”Ÿæˆç›‘æ§æŠ¥å‘Šï¼Œæ•°æ®åˆ†æ

**ğŸ› ï¸ å¼€å‘é›†æˆåœºæ™¯**
- **CI/CDé›†æˆ**ï¼šéƒ¨ç½²æ—¶è‡ªåŠ¨é…ç½®ç›‘æ§
- **CMDBå¯¹æ¥**ï¼šä¸é…ç½®ç®¡ç†æ•°æ®åº“åŒæ­¥
- **å‘Šè­¦å¤„ç†**ï¼šè‡ªåŠ¨åŒ–æ•…éšœå“åº”å’Œæ¢å¤
- **å®¹é‡è§„åˆ’**ï¼šåŸºäºç›‘æ§æ•°æ®è¿›è¡Œèµ„æºé¢„æµ‹

### 11.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ”¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
APIæƒé™æ§åˆ¶ï¼š
- ä½¿ç”¨ä¸“é—¨çš„APIè´¦æˆ·ï¼Œé¿å…ä½¿ç”¨admin
- å®šæœŸæ›´æ¢APIå¯†ç 
- é™åˆ¶APIè´¦æˆ·çš„æƒé™èŒƒå›´
- è®°å½•APIæ“ä½œæ—¥å¿—

è„šæœ¬å®‰å…¨ï¼š
- ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 
- ä½¿ç”¨é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡
- åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- å®šæœŸæ£€æŸ¥å’Œæ›´æ–°ä¾èµ–åº“
```

**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
```
æ‰¹é‡æ“ä½œä¼˜åŒ–ï¼š
- ä½¿ç”¨æ‰¹é‡APIè€Œä¸æ˜¯å¾ªç¯å•ä¸ªæ“ä½œ
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- å®ç°å¤±è´¥é‡è¯•æœºåˆ¶
- æ§åˆ¶å¹¶å‘æ•°é‡é¿å…å‹å®æœåŠ¡å™¨

ç½‘ç»œä¼˜åŒ–ï¼š
- ä½¿ç”¨è¿æ¥æ± å¤ç”¨è¿æ¥
- å¯ç”¨å‹ç¼©å‡å°‘ä¼ è¾“æ•°æ®é‡
- å°±è¿‘éƒ¨ç½²å‡å°‘ç½‘ç»œå»¶è¿Ÿ
- ç›‘æ§APIè°ƒç”¨æ€§èƒ½
```

**ğŸ”¸ ä»£ç ç»´æŠ¤å»ºè®®**
```
ä»£ç ç»„ç»‡ï¼š
- å°è£…é€šç”¨åŠŸèƒ½ä¸ºå‡½æ•°
- ä½¿ç”¨é¢å‘å¯¹è±¡è®¾è®¡
- æ·»åŠ è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜
- ç¼–å†™å•å…ƒæµ‹è¯•

é”™è¯¯å¤„ç†ï¼š
- æ•è·å¹¶å¤„ç†æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸
- æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
- å®ç°æ“ä½œå›æ»šæœºåˆ¶
- è®°å½•è¯¦ç»†çš„æ“ä½œæ—¥å¿—
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- APIè‡ªåŠ¨åŒ–ï¼Œæ•ˆç‡å¤§æå‡
- è®¤è¯å…ˆç™»å½•ï¼Œtokenæ˜¯é€šè¡Œè¯  
- å¢åˆ æ”¹æŸ¥æ ·æ ·é€šï¼Œæ‰¹é‡æ“ä½œæ›´è½»æ¾
- æ¨¡æ¿æ ‡å‡†åŒ–ï¼Œé…ç½®å¯¼å…¥å¯¼å‡ºä¾¿è¿ç§»
- å®‰å…¨æƒé™æ§ï¼Œæ€§èƒ½ä¼˜åŒ–è®°å¿ƒä¸­