---
title: 2ã€è¡¨å•éªŒè¯ä¸é”™è¯¯ä¿¡æ¯å±•ç¤º
---
## ğŸ“š ç›®å½•

1. [è¡¨å•éªŒè¯åŸºç¡€æ¦‚å¿µ](#1-è¡¨å•éªŒè¯åŸºç¡€æ¦‚å¿µ)
2. [JSR-303éªŒè¯æ³¨è§£è¯¦è§£](#2-jsr-303éªŒè¯æ³¨è§£è¯¦è§£)
3. [Spring MVCéªŒè¯é›†æˆ](#3-spring-mvcéªŒè¯é›†æˆ)
4. [BindingResulté”™è¯¯ç»“æœå¤„ç†](#4-bindingresulté”™è¯¯ç»“æœå¤„ç†)
5. [Thymeleafé”™è¯¯ä¿¡æ¯æ˜¾ç¤º](#5-thymeleafé”™è¯¯ä¿¡æ¯æ˜¾ç¤º)
6. [å­—æ®µçº§é”™è¯¯å¤„ç†](#6-å­—æ®µçº§é”™è¯¯å¤„ç†)
7. [å…¨å±€é”™è¯¯å¤„ç†](#7-å…¨å±€é”™è¯¯å¤„ç†)
8. [é”™è¯¯ä¿¡æ¯å›½é™…åŒ–](#8-é”™è¯¯ä¿¡æ¯å›½é™…åŒ–)
9. [è‡ªå®šä¹‰éªŒè¯å™¨](#9-è‡ªå®šä¹‰éªŒè¯å™¨)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“‹ è¡¨å•éªŒè¯åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è¡¨å•éªŒè¯


**é€šä¿—ç†è§£**ï¼šå°±åƒä½ åœ¨ç½‘ç«™æ³¨å†Œæ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥ä½ è¾“å…¥çš„å†…å®¹æ˜¯å¦ç¬¦åˆè¦æ±‚

```
ç”¨æˆ·æ³¨å†Œåœºæ™¯ï¼š
ç”¨æˆ·å â†’ å¿…é¡»å¡«å†™ï¼Œé•¿åº¦3-20ä¸ªå­—ç¬¦
é‚®ç®±   â†’ å¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼
å¹´é¾„   â†’ å¿…é¡»æ˜¯æ•°å­—ï¼ŒèŒƒå›´18-100

è¿™äº›æ£€æŸ¥è§„åˆ™å°±æ˜¯"è¡¨å•éªŒè¯"
```

**ä¸ºä»€ä¹ˆéœ€è¦éªŒè¯ï¼Ÿ**
- ğŸ›¡ï¸ **æ•°æ®å®‰å…¨**ï¼šé˜²æ­¢éæ³•æ•°æ®è¿›å…¥ç³»ç»Ÿ
- âœ… **æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿å¿…å¡«ä¿¡æ¯éƒ½æœ‰å€¼
- ğŸ“ **ä¸šåŠ¡è§„åˆ™**ï¼šç¡®ä¿æ•°æ®ç¬¦åˆä¸šåŠ¡è¦æ±‚
- ğŸ’¡ **ç”¨æˆ·ä½“éªŒ**ï¼šåŠæ—¶æç¤ºç”¨æˆ·è¾“å…¥é”™è¯¯

### 1.2 éªŒè¯çš„ä¸¤ç§æ–¹å¼


**å‰ç«¯éªŒè¯ vs åç«¯éªŒè¯**

```
æµè§ˆå™¨ç«¯                              æœåŠ¡å™¨ç«¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯éªŒè¯    â”‚                    â”‚  åç«¯éªŒè¯    â”‚
â”‚  HTML5éªŒè¯  â”‚  æäº¤è¡¨å•          â”‚  Javaä»£ç    â”‚
â”‚  JavaScript â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â†’         â”‚  éªŒè¯æ³¨è§£   â”‚
â”‚             â”‚                    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“                                    â†“
 å¿«é€Ÿåé¦ˆ                            å®‰å…¨å¯é 
 ç”¨æˆ·ä½“éªŒå¥½                          æ— æ³•ç»•è¿‡
```

**é‡è¦åŸåˆ™**ï¼š
> å‰ç«¯éªŒè¯æå‡ä½“éªŒï¼Œåç«¯éªŒè¯ä¿è¯å®‰å…¨
> æ°¸è¿œä¸è¦åªä¾èµ–å‰ç«¯éªŒè¯ï¼

### 1.3 éªŒè¯æµç¨‹æ•´ä½“è®¤è¯†


**å®Œæ•´çš„éªŒè¯æµç¨‹**

```
1. ç”¨æˆ·å¡«å†™è¡¨å•
   â†“
2. å‰ç«¯åˆæ­¥æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
   â†“
3. æäº¤åˆ°åç«¯
   â†“
4. åç«¯éªŒè¯è§„åˆ™æ£€æŸ¥
   â†“
5. æœ‰é”™è¯¯ï¼Ÿ
   æ˜¯ â†’ è¿”å›é”™è¯¯ä¿¡æ¯ â†’ æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
   å¦ â†’ å¤„ç†æ•°æ® â†’ ä¿å­˜åˆ°æ•°æ®åº“
```

---

## 2. ğŸ”– JSR-303éªŒè¯æ³¨è§£è¯¦è§£


### 2.1 JSR-303æ˜¯ä»€ä¹ˆ


**æ¦‚å¿µè§£é‡Š**ï¼š
- **JSR-303** å…¨ç§°æ˜¯ Java Specification Request 303
- ç¿»è¯‘è¿‡æ¥å°±æ˜¯"Javaè§„èŒƒè¯·æ±‚303å·"
- ç®€å•è¯´ï¼šå®ƒæ˜¯Javaå®˜æ–¹å®šä¹‰çš„**æ•°æ®éªŒè¯æ ‡å‡†è§„èŒƒ**

**é€šä¿—æ¯”å–»**ï¼š
å°±åƒçº¢ç»¿ç¯æ˜¯äº¤é€šè§„åˆ™çš„æ ‡å‡†ï¼ŒJSR-303å°±æ˜¯æ•°æ®éªŒè¯çš„æ ‡å‡†è§„åˆ™

### 2.2 å¸¸ç”¨éªŒè¯æ³¨è§£è¯¦è§£


**å¿…å¤‡æ³¨è§£ä¸€è§ˆè¡¨**

| æ³¨è§£ | ä½œç”¨è¯´æ˜ | ä½¿ç”¨ç¤ºä¾‹ | å®é™…åœºæ™¯ |
|------|---------|---------|---------|
| `@NotNull` | ä¸èƒ½ä¸ºnull | å¯¹è±¡ä¸èƒ½æ˜¯null | å¿…å¡«çš„å¯¹è±¡å­—æ®µ |
| `@NotEmpty` | ä¸èƒ½ä¸ºç©ºï¼ˆå­—ç¬¦ä¸²ã€é›†åˆï¼‰ | å­—ç¬¦ä¸²é•¿åº¦>0 | ç”¨æˆ·åå¿…å¡« |
| `@NotBlank` | ä¸èƒ½ä¸ºç©ºç™½ï¼ˆä¼šå»é™¤ç©ºæ ¼ï¼‰ | å»ç©ºæ ¼åé•¿åº¦>0 | è¯„è®ºå†…å®¹å¿…å¡« |
| `@Size` | é™åˆ¶é•¿åº¦æˆ–å¤§å° | é•¿åº¦åœ¨minå’Œmaxä¹‹é—´ | å¯†ç é•¿åº¦é™åˆ¶ |
| `@Min` / `@Max` | æ•°å€¼æœ€å°/æœ€å¤§å€¼ | æ•°å­—èŒƒå›´é™åˆ¶ | å¹´é¾„èŒƒå›´ |
| `@Email` | å¿…é¡»æ˜¯é‚®ç®±æ ¼å¼ | ç¬¦åˆé‚®ç®±è§„åˆ™ | ç”¨æˆ·é‚®ç®± |
| `@Pattern` | å¿…é¡»åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ | è‡ªå®šä¹‰æ ¼å¼éªŒè¯ | æ‰‹æœºå·éªŒè¯ |

**è¯¦ç»†æ³¨è§£è¯´æ˜**

**ğŸ”¸ @NotNullã€@NotEmptyã€@NotBlank çš„åŒºåˆ«**

```java
// è¿™ä¸‰ä¸ªæœ€å®¹æ˜“ææ··ï¼Œä¸€å®šè¦ç†è§£æ¸…æ¥šï¼

@NotNull     // åªæ£€æŸ¥æ˜¯å¦ä¸ºnullï¼Œç©ºå­—ç¬¦ä¸²""å¯ä»¥é€šè¿‡
private String name1;

@NotEmpty    // æ£€æŸ¥nullå’Œç©ºï¼Œä½†ç©ºæ ¼"  "å¯ä»¥é€šè¿‡
private String name2;

@NotBlank    // æœ€ä¸¥æ ¼ï¼Œnullã€ç©ºã€ç©ºæ ¼éƒ½ä¸è¡Œ
private String name3;

// å®é™…æµ‹è¯•
null         â†’ @NotNull(Ã—)  @NotEmpty(Ã—)  @NotBlank(Ã—)
""           â†’ @NotNull(âœ“)  @NotEmpty(Ã—)  @NotBlank(Ã—)
"   "        â†’ @NotNull(âœ“)  @NotEmpty(âœ“)  @NotBlank(Ã—)
"abc"        â†’ @NotNull(âœ“)  @NotEmpty(âœ“)  @NotBlank(âœ“)
```

**è®°å¿†å£è¯€**ï¼š
- NotNullåªçœ‹null
- NotEmptyçœ‹nullå’Œç©º
- NotBlankæœ€ä¸¥æ ¼ï¼Œç©ºæ ¼ä¹Ÿä¸è¡Œ

**ğŸ”¸ @Size é•¿åº¦é™åˆ¶**

```java
// ç”¨äºå­—ç¬¦ä¸²ã€é›†åˆã€æ•°ç»„çš„é•¿åº¦é™åˆ¶

@Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´")
private String username;

@Size(min = 1, message = "è‡³å°‘é€‰æ‹©ä¸€ä¸ªçˆ±å¥½")
private List<String> hobbies;
```

**ğŸ”¸ @Minã€@Max æ•°å€¼èŒƒå›´**

```java
// ç”¨äºæ•°å€¼ç±»å‹çš„èŒƒå›´é™åˆ¶

@Min(value = 18, message = "å¹´é¾„ä¸èƒ½å°äº18å²")
@Max(value = 100, message = "å¹´é¾„ä¸èƒ½å¤§äº100å²")
private Integer age;

@Min(0)
@Max(999999)
private BigDecimal salary;  // è–ªèµ„èŒƒå›´
```

**ğŸ”¸ @Email é‚®ç®±éªŒè¯**

```java
// è‡ªåŠ¨éªŒè¯é‚®ç®±æ ¼å¼

@Email(message = "è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼")
private String email;

// é€šè¿‡çš„æ ¼å¼ç¤ºä¾‹
"user@example.com"        â†’ âœ“
"test.user@domain.cn"     â†’ âœ“
"invalid-email"           â†’ Ã—
"@example.com"            â†’ Ã—
```

**ğŸ”¸ @Pattern æ­£åˆ™è¡¨è¾¾å¼éªŒè¯**

```java
// è‡ªå®šä¹‰æ ¼å¼éªŒè¯ï¼Œæœ€çµæ´»

// æ‰‹æœºå·éªŒè¯
@Pattern(regexp = "^1[3-9]\\d{9}$", 
         message = "è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ")
private String phone;

// èº«ä»½è¯éªŒè¯
@Pattern(regexp = "^[1-9]\\d{5}(18|19|20)\\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\\d|3[01])\\d{3}[\\dXx]$",
         message = "è¯·è¾“å…¥æ­£ç¡®çš„èº«ä»½è¯å·ç ")
private String idCard;
```

### 2.3 å®ä½“ç±»å®Œæ•´ç¤ºä¾‹


**ç”¨æˆ·æ³¨å†Œè¡¨å•å®ä½“ç±»**

```java
public class UserRegisterForm {
    
    // ç”¨æˆ·åï¼šå¿…å¡«ï¼Œ3-20ä¸ªå­—ç¬¦
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´")
    private String username;
    
    // å¯†ç ï¼šå¿…å¡«ï¼Œ6-20ä¸ªå­—ç¬¦
    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min = 6, max = 20, message = "å¯†ç é•¿åº¦å¿…é¡»åœ¨6-20ä¸ªå­—ç¬¦ä¹‹é—´")
    private String password;
    
    // é‚®ç®±ï¼šå¿…å¡«ï¼Œæ ¼å¼æ­£ç¡®
    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    // å¹´é¾„ï¼šå¿…å¡«ï¼Œ18-100ä¹‹é—´
    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º")
    @Min(value = 18, message = "å¹´é¾„ä¸èƒ½å°äº18å²")
    @Max(value = 100, message = "å¹´é¾„ä¸èƒ½å¤§äº100å²")
    private Integer age;
    
    // æ‰‹æœºå·ï¼šå¿…å¡«ï¼Œæ ¼å¼æ­£ç¡®
    @NotBlank(message = "æ‰‹æœºå·ä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
    
    // getterå’Œsetteræ–¹æ³•...
}
```

**è¦ç‚¹è¯´æ˜**ï¼š
- æ¯ä¸ªå­—æ®µéƒ½æœ‰æ˜ç¡®çš„éªŒè¯è§„åˆ™
- `message`å±æ€§å®šä¹‰äº†éªŒè¯å¤±è´¥æ—¶çš„æç¤ºä¿¡æ¯
- å¯ä»¥åœ¨ä¸€ä¸ªå­—æ®µä¸Šä½¿ç”¨å¤šä¸ªéªŒè¯æ³¨è§£

---

## 3. ğŸ”„ Spring MVCéªŒè¯é›†æˆ


### 3.1 éªŒè¯æ˜¯å¦‚ä½•å·¥ä½œçš„


**æ•´ä½“æµç¨‹ç†è§£**

```
å‰ç«¯è¡¨å•                     åç«¯Controller
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥  â”‚  HTTP POST    â”‚ 1. æ¥æ”¶æ•°æ®     â”‚
â”‚ æäº¤è¡¨å•  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ 2. è‡ªåŠ¨éªŒè¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ 3. è¿”å›ç»“æœ     â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ BindingResult  â”‚
                           â”‚ (éªŒè¯ç»“æœå¯¹è±¡)  â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Controllerä¸­å¯ç”¨éªŒè¯


**æ ¸å¿ƒçŸ¥è¯†ç‚¹**ï¼š
- ä½¿ç”¨ `@Valid` æˆ– `@Validated` æ³¨è§£å¼€å¯éªŒè¯
- ç´§è·Ÿä¸€ä¸ª `BindingResult` å‚æ•°æ¥æ”¶éªŒè¯ç»“æœ

**åŸºç¡€ç”¨æ³•**

```java
@Controller
public class UserController {
    
    @PostMapping("/register")
    public String register(@Valid @ModelAttribute("user") UserRegisterForm form,
                          BindingResult result,
                          Model model) {
        
        // æ£€æŸ¥æ˜¯å¦æœ‰éªŒè¯é”™è¯¯
        if (result.hasErrors()) {
            // æœ‰é”™è¯¯ï¼Œè¿”å›è¡¨å•é¡µé¢
            return "register";
        }
        
        // æ²¡æœ‰é”™è¯¯ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘
        // ... ä¿å­˜ç”¨æˆ·ä¿¡æ¯
        
        return "redirect:/success";
    }
}
```

**ä»£ç è§£é‡Š**ï¼š
- `@Valid`ï¼šå‘Šè¯‰Spring"è¯·éªŒè¯è¿™ä¸ªå¯¹è±¡"
- `@ModelAttribute("user")`ï¼šå°†è¡¨å•æ•°æ®ç»‘å®šåˆ°è¿™ä¸ªå¯¹è±¡ï¼Œå¹¶å‘½åä¸º"user"
- `BindingResult result`ï¼šå­˜æ”¾éªŒè¯ç»“æœçš„å¯¹è±¡
- `result.hasErrors()`ï¼šåˆ¤æ–­æ˜¯å¦æœ‰éªŒè¯é”™è¯¯

**âš ï¸ é‡è¦è§„åˆ™**ï¼š
> `BindingResult`å‚æ•°å¿…é¡»ç´§è·Ÿåœ¨`@Valid`å‚æ•°åé¢ï¼
> é¡ºåºé”™äº†ä¼šå¯¼è‡´éªŒè¯å¤±è´¥ç›´æ¥æŠ›å¼‚å¸¸

### 3.3 @Valid vs @Validated


**ä¸¤è€…çš„åŒºåˆ«**

| ç‰¹æ€§ | @Valid | @Validated |
|------|--------|-----------|
| æ¥æº | JSR-303æ ‡å‡† | Springæä¾› |
| åˆ†ç»„éªŒè¯ | ä¸æ”¯æŒ | æ”¯æŒ |
| åµŒå¥—éªŒè¯ | æ”¯æŒ | æ”¯æŒ |
| ä½¿ç”¨ä½ç½® | æ–¹æ³•å‚æ•°ã€å­—æ®µ | æ–¹æ³•å‚æ•°ã€ç±» |

**ä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªï¼Ÿ**
- ç®€å•éªŒè¯ â†’ ç”¨ `@Valid`
- éœ€è¦åˆ†ç»„éªŒè¯ â†’ ç”¨ `@Validated`

**åˆ†ç»„éªŒè¯ç¤ºä¾‹**ï¼ˆäº†è§£å³å¯ï¼‰

```java
// å®šä¹‰éªŒè¯åˆ†ç»„æ¥å£
public interface CreateGroup {}
public interface UpdateGroup {}

// å®ä½“ç±»ä¸­æŒ‡å®šåˆ†ç»„
public class User {
    
    @NotNull(groups = UpdateGroup.class)  // æ›´æ–°æ—¶å¿…é¡»æœ‰ID
    private Long id;
    
    @NotBlank(groups = {CreateGroup.class, UpdateGroup.class})
    private String username;
}

// Controllerä¸­ä½¿ç”¨
@PostMapping("/create")
public String create(@Validated(CreateGroup.class) User user, 
                     BindingResult result) {
    // ...
}
```

---

## 4. ğŸ“ BindingResulté”™è¯¯ç»“æœå¤„ç†


### 4.1 BindingResultæ˜¯ä»€ä¹ˆ


**æ¦‚å¿µç†è§£**ï¼š
`BindingResult`å°±åƒä¸€ä¸ª"é”™è¯¯æ”¶é›†å™¨"ï¼ŒéªŒè¯å¤±è´¥çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šå­˜åœ¨è¿™é‡Œ

**å®ƒåŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ**

```
BindingResultå¯¹è±¡
â”œâ”€â”€ æ˜¯å¦æœ‰é”™è¯¯ (hasErrors)
â”œâ”€â”€ é”™è¯¯æ•°é‡ (getErrorCount)
â”œâ”€â”€ æ‰€æœ‰é”™è¯¯ (getAllErrors)
â”‚   â”œâ”€â”€ å­—æ®µé”™è¯¯ (FieldError)
â”‚   â””â”€â”€ å…¨å±€é”™è¯¯ (ObjectError)
â””â”€â”€ ç‰¹å®šå­—æ®µçš„é”™è¯¯ (getFieldError)
```

### 4.2 è·å–é”™è¯¯ä¿¡æ¯çš„æ–¹æ³•


**å¸¸ç”¨æ–¹æ³•è¯¦è§£**

```java
@PostMapping("/register")
public String register(@Valid UserRegisterForm form, 
                      BindingResult result) {
    
    // 1. åˆ¤æ–­æ˜¯å¦æœ‰é”™è¯¯
    if (result.hasErrors()) {
        
        // 2. è·å–é”™è¯¯æ•°é‡
        int errorCount = result.getErrorCount();
        System.out.println("å…±æœ‰" + errorCount + "ä¸ªéªŒè¯é”™è¯¯");
        
        // 3. è·å–æ‰€æœ‰é”™è¯¯ä¿¡æ¯
        List<ObjectError> allErrors = result.getAllErrors();
        for (ObjectError error : allErrors) {
            System.out.println(error.getDefaultMessage());
        }
        
        // 4. è·å–æŸä¸ªå­—æ®µçš„é”™è¯¯
        FieldError usernameError = result.getFieldError("username");
        if (usernameError != null) {
            System.out.println("ç”¨æˆ·åé”™è¯¯ï¼š" + usernameError.getDefaultMessage());
        }
        
        return "register";
    }
    
    return "success";
}
```

### 4.3 FieldErrorè¯¦ç»†ä¿¡æ¯


**FieldErroråŒ…å«çš„ä¿¡æ¯**

```java
FieldError error = result.getFieldError("username");

error.getField()              // å­—æ®µåï¼š"username"
error.getRejectedValue()      // è¢«æ‹’ç»çš„å€¼ï¼šç”¨æˆ·è¾“å…¥çš„å€¼
error.getDefaultMessage()     // é”™è¯¯ä¿¡æ¯ï¼š"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"
error.getCode()              // é”™è¯¯ä»£ç ï¼š"NotBlank"
```

**å®é™…åº”ç”¨åœºæ™¯**

```java
// åœºæ™¯ï¼šéœ€è¦è¿”å›JSONæ ¼å¼çš„é”™è¯¯ä¿¡æ¯ç»™å‰ç«¯
@PostMapping("/api/register")
@ResponseBody
public Map<String, Object> registerApi(@Valid UserRegisterForm form,
                                       BindingResult result) {
    Map<String, Object> response = new HashMap<>();
    
    if (result.hasErrors()) {
        // æ„å»ºé”™è¯¯ä¿¡æ¯
        Map<String, String> errors = new HashMap<>();
        for (FieldError error : result.getFieldErrors()) {
            errors.put(error.getField(), error.getDefaultMessage());
        }
        
        response.put("success", false);
        response.put("errors", errors);
        return response;
    }
    
    response.put("success", true);
    return response;
}
```

**è¿”å›çš„JSONæ ¼å¼**ï¼š

```json
{
  "success": false,
  "errors": {
    "username": "ç”¨æˆ·åä¸èƒ½ä¸ºç©º",
    "email": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®",
    "age": "å¹´é¾„ä¸èƒ½å°äº18å²"
  }
}
```

---

## 5. ğŸ¨ Thymeleafé”™è¯¯ä¿¡æ¯æ˜¾ç¤º


### 5.1 th:errors åŸºç¡€ç”¨æ³•


**th:errorsçš„ä½œç”¨**ï¼šåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºéªŒè¯é”™è¯¯ä¿¡æ¯

**åŸºæœ¬è¯­æ³•**

```html
<!-- æ˜¾ç¤ºæŸä¸ªå­—æ®µçš„é”™è¯¯ä¿¡æ¯ -->
<span th:errors="*{username}"></span>

<!-- æˆ–è€…ç”¨å®Œæ•´å†™æ³• -->
<span th:errors="${user.username}"></span>
```

**å®Œæ•´è¡¨å•ç¤ºä¾‹**

```html
<form th:action="@{/register}" th:object="${user}" method="post">
    
    <!-- ç”¨æˆ·åè¾“å…¥ -->
    <div>
        <label>ç”¨æˆ·åï¼š</label>
        <input type="text" th:field="*{username}" />
        <!-- é”™è¯¯ä¿¡æ¯æ˜¾ç¤º -->
        <span th:if="${#fields.hasErrors('username')}" 
              th:errors="*{username}" 
              class="error"></span>
    </div>
    
    <!-- é‚®ç®±è¾“å…¥ -->
    <div>
        <label>é‚®ç®±ï¼š</label>
        <input type="email" th:field="*{email}" />
        <span th:if="${#fields.hasErrors('email')}" 
              th:errors="*{email}" 
              class="error"></span>
    </div>
    
    <button type="submit">æ³¨å†Œ</button>
</form>
```

### 5.2 #fieldså·¥å…·å¯¹è±¡


**#fieldsæä¾›çš„éªŒè¯ç›¸å…³æ–¹æ³•**

| æ–¹æ³• | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| `hasErrors('å­—æ®µå')` | åˆ¤æ–­å­—æ®µæ˜¯å¦æœ‰é”™è¯¯ | `${#fields.hasErrors('username')}` |
| `hasGlobalErrors()` | åˆ¤æ–­æ˜¯å¦æœ‰å…¨å±€é”™è¯¯ | `${#fields.hasGlobalErrors()}` |
| `hasAnyErrors()` | åˆ¤æ–­æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯ | `${#fields.hasAnyErrors()}` |
| `errors('å­—æ®µå')` | è·å–å­—æ®µçš„æ‰€æœ‰é”™è¯¯ | `${#fields.errors('username')}` |

**ä½¿ç”¨ç¤ºä¾‹**

```html
<!-- æ–¹å¼1ï¼šç®€å•æ˜¾ç¤º -->
<div th:if="${#fields.hasErrors('username')}">
    <span th:errors="*{username}" class="error"></span>
</div>

<!-- æ–¹å¼2ï¼šéå†æ‰€æœ‰é”™è¯¯ -->
<div th:if="${#fields.hasErrors('username')}">
    <ul>
        <li th:each="err : ${#fields.errors('username')}" 
            th:text="${err}"></li>
    </ul>
</div>

<!-- æ–¹å¼3ï¼šæ¡ä»¶æ ·å¼ -->
<input type="text" 
       th:field="*{username}"
       th:classappend="${#fields.hasErrors('username')} ? 'input-error' : ''" />
```

### 5.3 é”™è¯¯ä¿¡æ¯æ ·å¼ç¾åŒ–


**CSSæ ·å¼ç¤ºä¾‹**

```html
<style>
    /* é”™è¯¯æ–‡æœ¬æ ·å¼ */
    .error {
        color: #dc3545;
        font-size: 0.875em;
        margin-top: 0.25rem;
        display: block;
    }
    
    /* é”™è¯¯è¾“å…¥æ¡†æ ·å¼ */
    .input-error {
        border-color: #dc3545;
        background-color: #fff5f5;
    }
    
    /* é”™è¯¯æç¤ºæ¡† */
    .alert-error {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        padding: 0.75rem;
        border-radius: 0.25rem;
        margin-bottom: 1rem;
    }
</style>

<!-- åº”ç”¨æ ·å¼ -->
<div class="form-group">
    <input type="text" 
           th:field="*{username}"
           th:classappend="${#fields.hasErrors('username')} ? 'input-error' : ''"
           class="form-control" />
    <span th:if="${#fields.hasErrors('username')}"
          th:errors="*{username}"
          class="error"></span>
</div>
```

---

## 6. ğŸ¯ å­—æ®µçº§é”™è¯¯å¤„ç†


### 6.1 å•ä¸ªå­—æ®µé”™è¯¯å¤„ç†æ¨¡å¼


**æ ‡å‡†å¤„ç†æ¨¡å¼**

```html
<!-- æ¨¡å¼ç»“æ„ -->
<div class="form-group">
    <!-- 1. æ ‡ç­¾ -->
    <label for="username">ç”¨æˆ·å</label>
    
    <!-- 2. è¾“å…¥æ¡†ï¼ˆå¸¦é”™è¯¯æ ·å¼ï¼‰ -->
    <input type="text" 
           id="username"
           th:field="*{username}"
           th:classappend="${#fields.hasErrors('username')} ? 'is-invalid' : ''"
           class="form-control" />
    
    <!-- 3. é”™è¯¯æç¤º -->
    <div th:if="${#fields.hasErrors('username')}" class="invalid-feedback">
        <span th:errors="*{username}"></span>
    </div>
</div>
```

### 6.2 å¤æ‚å­—æ®µéªŒè¯


**å¤šä¸ªéªŒè¯è§„åˆ™çš„å­—æ®µ**

```java
// å®ä½“ç±»
public class Product {
    
    @NotBlank(message = "å•†å“åç§°ä¸èƒ½ä¸ºç©º")
    @Size(min = 2, max = 50, message = "å•†å“åç§°é•¿åº¦å¿…é¡»åœ¨2-50ä¸ªå­—ç¬¦ä¹‹é—´")
    @Pattern(regexp = "^[\\u4e00-\\u9fa5a-zA-Z0-9]+$", 
             message = "å•†å“åç§°åªèƒ½åŒ…å«ä¸­æ–‡ã€å­—æ¯å’Œæ•°å­—")
    private String name;
    
    @NotNull(message = "å•†å“ä»·æ ¼ä¸èƒ½ä¸ºç©º")
    @DecimalMin(value = "0.01", message = "å•†å“ä»·æ ¼å¿…é¡»å¤§äº0")
    @DecimalMax(value = "999999.99", message = "å•†å“ä»·æ ¼ä¸èƒ½è¶…è¿‡999999.99")
    private BigDecimal price;
}
```

**é¡µé¢æ˜¾ç¤ºå¤šä¸ªé”™è¯¯**

```html
<div class="form-group">
    <label>å•†å“åç§°</label>
    <input type="text" th:field="*{name}" class="form-control" />
    
    <!-- æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ä¿¡æ¯ -->
    <div th:if="${#fields.hasErrors('name')}" class="error-messages">
        <ul>
            <li th:each="err : ${#fields.errors('name')}" 
                th:text="${err}"></li>
        </ul>
    </div>
</div>
```

### 6.3 åŠ¨æ€é”™è¯¯æç¤º


**æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒå›¾æ ‡**

```html
<div class="form-group">
    <input type="text" th:field="*{username}" />
    
    <!-- æ ¹æ®ä¸åŒé”™è¯¯æ˜¾ç¤ºä¸åŒå›¾æ ‡ -->
    <span th:if="${#fields.hasErrors('username')}">
        <i th:if="${#strings.contains(#fields.errors('username')[0], 'ä¸èƒ½ä¸ºç©º')}" 
           class="icon-required"></i>
        <i th:if="${#strings.contains(#fields.errors('username')[0], 'é•¿åº¦')}" 
           class="icon-length"></i>
        <span th:errors="*{username}"></span>
    </span>
</div>
```

---

## 7. ğŸŒ å…¨å±€é”™è¯¯å¤„ç†


### 7.1 ä»€ä¹ˆæ˜¯å…¨å±€é”™è¯¯


**æ¦‚å¿µç†è§£**ï¼š
å…¨å±€é”™è¯¯ä¸æ˜¯é’ˆå¯¹æŸä¸ªå…·ä½“å­—æ®µçš„é”™è¯¯ï¼Œè€Œæ˜¯æ•´ä¸ªè¡¨å•æˆ–ä¸šåŠ¡é€»è¾‘çš„é”™è¯¯

**å¸¸è§åœºæ™¯**ï¼š
```
âœ“ ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´
âœ“ ç”¨æˆ·åå·²å­˜åœ¨ï¼ˆéœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼‰
âœ“ éªŒè¯ç é”™è¯¯
âœ“ ä¸šåŠ¡è§„åˆ™å†²çª
```

### 7.2 æ·»åŠ å…¨å±€é”™è¯¯


**åœ¨Controllerä¸­æ·»åŠ å…¨å±€é”™è¯¯**

```java
@PostMapping("/register")
public String register(@Valid UserRegisterForm form,
                      BindingResult result) {
    
    // 1. å…ˆè¿›è¡Œå­—æ®µéªŒè¯
    if (result.hasErrors()) {
        return "register";
    }
    
    // 2. ä¸šåŠ¡é€»è¾‘éªŒè¯
    if (userService.existsByUsername(form.getUsername())) {
        // æ·»åŠ å…¨å±€é”™è¯¯
        result.reject("username.exists", "è¯¥ç”¨æˆ·åå·²è¢«æ³¨å†Œ");
        return "register";
    }
    
    if (!form.getPassword().equals(form.getConfirmPassword())) {
        // æ·»åŠ å…¨å±€é”™è¯¯
        result.reject("password.mismatch", "ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´");
        return "register";
    }
    
    // 3. ä¿å­˜ç”¨æˆ·
    userService.save(form);
    return "redirect:/success";
}
```

**æ–¹æ³•è¯´æ˜**ï¼š
- `result.reject(é”™è¯¯ä»£ç , é”™è¯¯ä¿¡æ¯)`ï¼šæ·»åŠ å…¨å±€é”™è¯¯
- é”™è¯¯ä»£ç ç”¨äºå›½é™…åŒ–ï¼Œæš‚æ—¶å¯ä»¥éšä¾¿å†™
- é”™è¯¯ä¿¡æ¯æ˜¯æ˜¾ç¤ºç»™ç”¨æˆ·çš„æç¤º

### 7.3 æ˜¾ç¤ºå…¨å±€é”™è¯¯


**é¡µé¢æ˜¾ç¤ºå…¨å±€é”™è¯¯**

```html
<!-- æ–¹å¼1ï¼šæ˜¾ç¤ºæ‰€æœ‰å…¨å±€é”™è¯¯ -->
<div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger">
    <ul>
        <li th:each="err : ${#fields.globalErrors()}" th:text="${err}"></li>
    </ul>
</div>

<!-- æ–¹å¼2ï¼šæ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ï¼ˆåŒ…æ‹¬å­—æ®µé”™è¯¯å’Œå…¨å±€é”™è¯¯ï¼‰ -->
<div th:if="${#fields.hasAnyErrors()}" class="alert alert-danger">
    <ul>
        <li th:each="err : ${#fields.allErrors()}" th:text="${err}"></li>
    </ul>
</div>
```

**å®Œæ•´è¡¨å•ç¤ºä¾‹**

```html
<form th:action="@{/register}" th:object="${user}" method="post">
    
    <!-- å…¨å±€é”™è¯¯æç¤ºåŒºåŸŸ -->
    <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger">
        <h4>æ³¨å†Œå¤±è´¥ï¼š</h4>
        <ul>
            <li th:each="err : ${#fields.globalErrors()}" th:text="${err}"></li>
        </ul>
    </div>
    
    <!-- è¡¨å•å­—æ®µ -->
    <div>
        <input type="text" th:field="*{username}" />
        <span th:if="${#fields.hasErrors('username')}" 
              th:errors="*{username}"></span>
    </div>
    
    <div>
        <input type="password" th:field="*{password}" />
        <span th:if="${#fields.hasErrors('password')}" 
              th:errors="*{password}"></span>
    </div>
    
    <div>
        <input type="password" th:field="*{confirmPassword}" />
    </div>
    
    <button type="submit">æ³¨å†Œ</button>
</form>
```

---

## 8. ğŸŒ é”™è¯¯ä¿¡æ¯å›½é™…åŒ–


### 8.1 ä»€ä¹ˆæ˜¯å›½é™…åŒ–


**æ¦‚å¿µç†è§£**ï¼š
å›½é™…åŒ–ï¼ˆi18nï¼‰å°±æ˜¯è®©ç³»ç»Ÿæ”¯æŒå¤šç§è¯­è¨€ï¼Œæ ¹æ®ç”¨æˆ·çš„è¯­è¨€ç¯å¢ƒæ˜¾ç¤ºå¯¹åº”çš„æ–‡å­—

```
ä¸­æ–‡ç¯å¢ƒï¼šç”¨æˆ·åä¸èƒ½ä¸ºç©º
è‹±æ–‡ç¯å¢ƒï¼šUsername cannot be empty
æ—¥æ–‡ç¯å¢ƒï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯ç©ºã«ã§ãã¾ã›ã‚“
```

### 8.2 é…ç½®å›½é™…åŒ–èµ„æºæ–‡ä»¶


**æ­¥éª¤1ï¼šåˆ›å»ºèµ„æºæ–‡ä»¶**

```
resources/
  â”œâ”€â”€ messages.properties          # é»˜è®¤ï¼ˆé€šå¸¸æ˜¯ä¸­æ–‡ï¼‰
  â”œâ”€â”€ messages_en_US.properties    # è‹±æ–‡
  â””â”€â”€ messages_zh_CN.properties    # ç®€ä½“ä¸­æ–‡
```

**messages.propertiesï¼ˆä¸­æ–‡ï¼‰**

```properties
# ç”¨æˆ·éªŒè¯æ¶ˆæ¯
user.username.notblank=ç”¨æˆ·åä¸èƒ½ä¸ºç©º
user.username.size=ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨{min}-{max}ä¸ªå­—ç¬¦ä¹‹é—´
user.email.invalid=é‚®ç®±æ ¼å¼ä¸æ­£ç¡®
user.age.range=å¹´é¾„å¿…é¡»åœ¨{min}-{max}å²ä¹‹é—´

# å…¨å±€é”™è¯¯æ¶ˆæ¯
username.exists=è¯¥ç”¨æˆ·åå·²è¢«æ³¨å†Œ
password.mismatch=ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´
```

**messages_en_US.propertiesï¼ˆè‹±æ–‡ï¼‰**

```properties
# User validation messages
user.username.notblank=Username cannot be empty
user.username.size=Username length must be between {min} and {max} characters
user.email.invalid=Invalid email format
user.age.range=Age must be between {min} and {max}

# Global error messages
username.exists=Username already exists
password.mismatch=Passwords do not match
```

**æ­¥éª¤2ï¼šSpring Booté…ç½®**

```yaml
# application.yml
spring:
  messages:
    basename: messages  # èµ„æºæ–‡ä»¶å
    encoding: UTF-8     # ç¼–ç 
```

### 8.3 ä½¿ç”¨å›½é™…åŒ–æ¶ˆæ¯


**æ–¹å¼1ï¼šåœ¨éªŒè¯æ³¨è§£ä¸­å¼•ç”¨**

```java
public class UserRegisterForm {
    
    @NotBlank(message = "{user.username.notblank}")
    @Size(min = 3, max = 20, message = "{user.username.size}")
    private String username;
    
    @Email(message = "{user.email.invalid}")
    private String email;
    
    @Min(value = 18, message = "{user.age.range}")
    @Max(value = 100, message = "{user.age.range}")
    private Integer age;
}
```

**è¦ç‚¹è¯´æ˜**ï¼š
- ä½¿ç”¨ `{æ¶ˆæ¯key}` çš„æ ¼å¼å¼•ç”¨å›½é™…åŒ–æ¶ˆæ¯
- `{min}`ã€`{max}` ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºæ³¨è§£ä¸­çš„å€¼

**æ–¹å¼2ï¼šåœ¨Controllerä¸­å¼•ç”¨**

```java
@Autowired
private MessageSource messageSource;

@PostMapping("/register")
public String register(@Valid UserRegisterForm form,
                      BindingResult result,
                      Locale locale) {  // æ³¨å…¥Localeè·å–å½“å‰è¯­è¨€ç¯å¢ƒ
    
    if (userService.existsByUsername(form.getUsername())) {
        String message = messageSource.getMessage(
            "username.exists",    // æ¶ˆæ¯key
            null,                 // å‚æ•°ï¼ˆæ²¡æœ‰å‚æ•°ä¼ nullï¼‰
            locale               // è¯­è¨€ç¯å¢ƒ
        );
        result.reject("username.exists", message);
        return "register";
    }
    
    return "redirect:/success";
}
```

### 8.4 å¸¦å‚æ•°çš„å›½é™…åŒ–æ¶ˆæ¯


**èµ„æºæ–‡ä»¶å®šä¹‰**

```properties
# messages.properties
welcome.message=æ¬¢è¿ {0}ï¼Œæ‚¨å·²æˆåŠŸæ³¨å†Œï¼ä»Šå¤©æ˜¯ {1}
order.total=è®¢å•æ€»é¢ï¼š{0} å…ƒï¼Œå…± {1} ä»¶å•†å“

# messages_en_US.properties
welcome.message=Welcome {0}, you have successfully registered! Today is {1}
order.total=Order total: ${0}, {1} items
```

**ä½¿ç”¨å¸¦å‚æ•°çš„æ¶ˆæ¯**

```java
@GetMapping("/welcome")
public String welcome(Model model, Locale locale) {
    
    String username = "å¼ ä¸‰";
    String date = LocalDate.now().toString();
    
    String message = messageSource.getMessage(
        "welcome.message",
        new Object[]{username, date},  // å‚æ•°æ•°ç»„
        locale
    );
    
    model.addAttribute("message", message);
    return "welcome";
}
```

---

## 9. ğŸ”§ è‡ªå®šä¹‰éªŒè¯å™¨


### 9.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰éªŒè¯å™¨


**æ ‡å‡†æ³¨è§£æ— æ³•æ»¡è¶³çš„åœºæ™¯**ï¼š
```
âœ“ èº«ä»½è¯å·ç éªŒè¯ï¼ˆå¤æ‚è§„åˆ™ï¼‰
âœ“ æ‰‹æœºå·éªŒè¯ï¼ˆä¸åŒå›½å®¶æ ¼å¼ä¸åŒï¼‰
âœ“ ä¸šåŠ¡ç‰¹å®šè§„åˆ™ï¼ˆå¦‚ï¼šä¼šå‘˜ç­‰çº§éªŒè¯ï¼‰
âœ“ è·¨å­—æ®µéªŒè¯ï¼ˆå¦‚ï¼šå¼€å§‹æ—¥æœŸå¿…é¡»å°äºç»“æŸæ—¥æœŸï¼‰
```

### 9.2 åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£


**æ­¥éª¤1ï¼šå®šä¹‰éªŒè¯æ³¨è§£**

```java
import javax.validation.Constraint;
import javax.validation.Payload;
import java.lang.annotation.*;

@Target({ElementType.FIELD})           // å¯ä»¥ç”¨åœ¨å­—æ®µä¸Š
@Retention(RetentionPolicy.RUNTIME)    // è¿è¡Œæ—¶æœ‰æ•ˆ
@Constraint(validatedBy = PhoneValidator.class)  // æŒ‡å®šéªŒè¯å™¨
@Documented
public @interface Phone {
    
    // é»˜è®¤é”™è¯¯æ¶ˆæ¯
    String message() default "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®";
    
    // åˆ†ç»„
    Class<?>[] groups() default {};
    
    // è´Ÿè½½
    Class<? extends Payload>[] payload() default {};
}
```

**æ­¥éª¤2ï¼šå®ç°éªŒè¯å™¨**

```java
import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;

public class PhoneValidator implements ConstraintValidator<Phone, String> {
    
    // æ‰‹æœºå·æ­£åˆ™è¡¨è¾¾å¼
    private static final String PHONE_PATTERN = "^1[3-9]\\d{9}$";
    
    @Override
    public void initialize(Phone constraintAnnotation) {
        // åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯ä»¥è·å–æ³¨è§£çš„å±æ€§å€¼
    }
    
    @Override
    public boolean isValid(String value, ConstraintValidatorContext context) {
        // valueä¸ºnullæ—¶ï¼Œä¸è¿›è¡ŒéªŒè¯ï¼ˆè®©@NotNullå»å¤„ç†ï¼‰
        if (value == null || value.isEmpty()) {
            return true;
        }
        
        // éªŒè¯æ‰‹æœºå·æ ¼å¼
        return value.matches(PHONE_PATTERN);
    }
}
```

**æ­¥éª¤3ï¼šä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£**

```java
public class UserRegisterForm {
    
    @NotBlank(message = "æ‰‹æœºå·ä¸èƒ½ä¸ºç©º")
    @Phone(message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")  // ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£
    private String phone;
}
```

### 9.3 å¸¦å‚æ•°çš„è‡ªå®šä¹‰éªŒè¯å™¨


**åœºæ™¯ï¼šéªŒè¯å¹´é¾„èŒƒå›´ï¼ˆå¯é…ç½®ï¼‰**

```java
@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = AgeRangeValidator.class)
public @interface AgeRange {
    
    String message() default "å¹´é¾„ä¸åœ¨å…è®¸èŒƒå›´å†…";
    
    int min() default 0;      // æœ€å°å¹´é¾„
    
    int max() default 150;    // æœ€å¤§å¹´é¾„
    
    Class<?>[] groups() default {};
    
    Class<? extends Payload>[] payload() default {};
}
```

**éªŒè¯å™¨å®ç°**

```java
public class AgeRangeValidator implements ConstraintValidator<AgeRange, Integer> {
    
    private int min;
    private int max;
    
    @Override
    public void initialize(AgeRange constraintAnnotation) {
        this.min = constraintAnnotation.min();
        this.max = constraintAnnotation.max();
    }
    
    @Override
    public boolean isValid(Integer value, ConstraintValidatorContext context) {
        if (value == null) {
            return true;
        }
        
        return value >= min && value <= max;
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**

```java
public class User {
    
    @AgeRange(min = 18, max = 60, message = "å‘˜å·¥å¹´é¾„å¿…é¡»åœ¨18-60å²ä¹‹é—´")
    private Integer age;
}
```

### 9.4 è·¨å­—æ®µéªŒè¯


**åœºæ™¯ï¼šéªŒè¯ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´**

```java
@Target({ElementType.TYPE})  // ç”¨åœ¨ç±»ä¸Š
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = PasswordMatchesValidator.class)
public @interface PasswordMatches {
    
    String message() default "ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´";
    
    Class<?>[] groups() default {};
    
    Class<? extends Payload>[] payload() default {};
}
```

**éªŒè¯å™¨å®ç°**

```java
public class PasswordMatchesValidator 
    implements ConstraintValidator<PasswordMatches, UserRegisterForm> {
    
    @Override
    public boolean isValid(UserRegisterForm form, ConstraintValidatorContext context) {
        if (form == null) {
            return true;
        }
        
        String password = form.getPassword();
        String confirmPassword = form.getConfirmPassword();
        
        if (password == null || confirmPassword == null) {
            return true;
        }
        
        return password.equals(confirmPassword);
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**

```java
@PasswordMatches  // ç”¨åœ¨ç±»ä¸Š
public class UserRegisterForm {
    
    @NotBlank
    private String password;
    
    @NotBlank
    private String confirmPassword;
    
    // getterå’Œsetter
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ éªŒè¯æµç¨‹**
```
è¡¨å•æäº¤ â†’ Controlleræ¥æ”¶ â†’ @Validè§¦å‘éªŒè¯ â†’ 
BindingResultæ”¶é›†é”™è¯¯ â†’ é¡µé¢æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
```

**ğŸ”¸ å…³é”®æ³¨è§£**

| æ³¨è§£ç±»å‹ | æ ¸å¿ƒä½œç”¨ | è®°å¿†è¦ç‚¹ |
|---------|---------|---------|
| `@NotBlank` | ä¸èƒ½ä¸ºç©ºç™½ | æœ€ä¸¥æ ¼ï¼Œç©ºæ ¼ä¹Ÿä¸è¡Œ |
| `@Size` | é™åˆ¶é•¿åº¦ | å­—ç¬¦ä¸²ã€é›†åˆéƒ½èƒ½ç”¨ |
| `@Email` | é‚®ç®±æ ¼å¼ | è‡ªåŠ¨éªŒè¯æ ¼å¼ |
| `@Pattern` | æ­£åˆ™éªŒè¯ | æœ€çµæ´»ï¼Œè‡ªå®šä¹‰è§„åˆ™ |
| `@Valid` | å¯ç”¨éªŒè¯ | æ”¾åœ¨å‚æ•°å‰é¢ |

**ğŸ”¸ Thymeleafæ ¸å¿ƒå±æ€§**

```html
th:field="*{å­—æ®µå}"        <!-- ç»‘å®šå­—æ®µ -->
th:errors="*{å­—æ®µå}"       <!-- æ˜¾ç¤ºé”™è¯¯ -->
#fields.hasErrors('å­—æ®µå')  <!-- åˆ¤æ–­æ˜¯å¦æœ‰é”™è¯¯ -->
```

### 10.2 å®æˆ˜æŠ€å·§æ€»ç»“


**âœ… æœ€ä½³å®è·µ**

1. **éªŒè¯è§„åˆ™æ¸…æ™°åŒ–**
```java
// å¥½çš„å†™æ³•ï¼šæ¯ä¸ªè§„åˆ™éƒ½æœ‰æ˜ç¡®çš„é”™è¯¯æç¤º
@NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
@Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´")
private String username;
```

2. **å‰åç«¯éªŒè¯é…åˆ**
```
å‰ç«¯ï¼šHTML5éªŒè¯ + JavaScriptéªŒè¯ï¼ˆå¿«é€Ÿåé¦ˆï¼‰
åç«¯ï¼šæ³¨è§£éªŒè¯ + ä¸šåŠ¡éªŒè¯ï¼ˆå®‰å…¨ä¿éšœï¼‰
```

3. **é”™è¯¯ä¿¡æ¯å‹å¥½åŒ–**
```
âŒ ä¸å¥½ï¼šNotBlank.username
âœ… å¥½ï¼šç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼Œè¯·è¾“å…¥3-20ä¸ªå­—ç¬¦
```

4. **å›½é™…åŒ–ä»ä¸€å¼€å§‹**
```java
// å³ä½¿æš‚æ—¶åªæœ‰ä¸­æ–‡ï¼Œä¹Ÿç”¨å›½é™…åŒ–key
@NotBlank(message = "{user.username.notblank}")
```

### 10.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**Q1ï¼šä¸ºä»€ä¹ˆéªŒè¯ä¸ç”Ÿæ•ˆï¼Ÿ**
```
æ£€æŸ¥æ¸…å•ï¼š
âœ“ æ˜¯å¦æ·»åŠ äº†@Validæ³¨è§£
âœ“ BindingResultæ˜¯å¦ç´§è·Ÿ@Validå‚æ•°
âœ“ æ˜¯å¦å¯¼å…¥äº†æ­£ç¡®çš„javax.validationåŒ…
âœ“ å­—æ®µæ˜¯å¦æœ‰getter/setteræ–¹æ³•
```

**Q2ï¼šå¦‚ä½•å¤„ç†å¤æ‚ä¸šåŠ¡éªŒè¯ï¼Ÿ**
```java
// å…ˆå­—æ®µéªŒè¯ï¼Œå†ä¸šåŠ¡éªŒè¯
if (result.hasErrors()) {
    return "form";  // å­—æ®µéªŒè¯å¤±è´¥
}

// ä¸šåŠ¡éªŒè¯
if (ä¸šåŠ¡è§„åˆ™ä¸æ»¡è¶³) {
    result.reject("é”™è¯¯ç ", "é”™è¯¯ä¿¡æ¯");
    return "form";
}
```

**Q3ï¼šå‰ç«¯å¦‚ä½•é…åˆï¼Ÿ**
```html
<!-- 1. è¡¨å•æäº¤å‰ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤ -->
<button type="submit" onclick="this.disabled=true">æäº¤</button>

<!-- 2. ä½¿ç”¨HTML5éªŒè¯æä¾›åˆæ­¥åé¦ˆ -->
<input type="email" required pattern="...">

<!-- 3. Ajaxæäº¤æ—¶å¤„ç†åç«¯è¿”å›çš„é”™è¯¯ -->
<script>
$.post(url, data, function(response) {
    if (response.errors) {
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    }
});
</script>
```

### 10.4 å­¦ä¹ è·¯çº¿å»ºè®®


**ğŸ“š å­¦ä¹ é¡ºåº**

```
ç¬¬ä¸€æ­¥ï¼šåŸºç¡€éªŒè¯
  â”œâ”€â”€ æŒæ¡å¸¸ç”¨æ³¨è§£ï¼ˆ@NotBlankã€@Sizeç­‰ï¼‰
  â”œâ”€â”€ ç†è§£@Validå’ŒBindingResult
  â””â”€â”€ å­¦ä¼šåœ¨é¡µé¢æ˜¾ç¤ºé”™è¯¯

ç¬¬äºŒæ­¥ï¼šè¿›é˜¶æŠ€å·§
  â”œâ”€â”€ å…¨å±€é”™è¯¯å¤„ç†
  â”œâ”€â”€ é”™è¯¯ä¿¡æ¯å›½é™…åŒ–
  â””â”€â”€ åˆ†ç»„éªŒè¯

ç¬¬ä¸‰æ­¥ï¼šé«˜çº§åº”ç”¨
  â”œâ”€â”€ è‡ªå®šä¹‰éªŒè¯å™¨
  â”œâ”€â”€ è·¨å­—æ®µéªŒè¯
  â””â”€â”€ å¤æ‚ä¸šåŠ¡éªŒè¯
```

**ğŸ¯ å®æˆ˜ç»ƒä¹ å»ºè®®**

1. **ç”¨æˆ·æ³¨å†Œè¡¨å•**
   - åŒ…å«ç”¨æˆ·åã€å¯†ç ã€é‚®ç®±ã€æ‰‹æœºå·
   - å®ç°å®Œæ•´çš„éªŒè¯å’Œé”™è¯¯æç¤º
   
2. **å•†å“å‘å¸ƒè¡¨å•**
   - åŒ…å«åç§°ã€ä»·æ ¼ã€åˆ†ç±»ã€æè¿°
   - å®ç°å­—æ®µéªŒè¯å’Œä¸šåŠ¡è§„åˆ™éªŒè¯

3. **è®¢å•æäº¤è¡¨å•**
   - åŒ…å«æ”¶è´§åœ°å€ã€è”ç³»æ–¹å¼ã€æ”¯ä»˜æ–¹å¼
   - å®ç°å¤æ‚çš„è·¨å­—æ®µéªŒè¯

### 10.5 æ ¸å¿ƒè®°å¿†å£è¯€


```
è¡¨å•éªŒè¯ä¸‰æ­¥èµ°ï¼š
ä¸€ã€å®ä½“ç±»æ‰“æ³¨è§£ï¼Œè§„åˆ™æ¸…æ¥šé”™è¯¯æ˜
äºŒã€ControlleråŠ @Validï¼Œç´§è·ŸResultæ”¶é”™è¯¯
ä¸‰ã€é¡µé¢ç”¨th:errorsï¼Œå‹å¥½æç¤ºç»™ç”¨æˆ·

éªŒè¯æ³¨è§£è¦è®°ç‰¢ï¼š
NotBlankæœ€ä¸¥æ ¼ï¼ŒSizeé™é•¿åº¦
EmailéªŒé‚®ç®±ï¼ŒPatternæœ€çµæ´»
Minå’ŒMaxç®¡æ•°å€¼ï¼ŒValidå¼€å¯éªŒè¯

é”™è¯¯å¤„ç†æœ‰æŠ€å·§ï¼š
å­—æ®µé”™è¯¯å•ç‹¬æ˜¾ï¼Œå…¨å±€é”™è¯¯é¡¶éƒ¨æ
å›½é™…åŒ–æ—©å‡†å¤‡ï¼Œè‡ªå®šä¹‰éªŒè¯è¦çµæ´»
```

---

## ğŸ“ ç»“è¯­


è¡¨å•éªŒè¯æ˜¯Webå¼€å‘ä¸­å¿…ä¸å¯å°‘çš„ç¯èŠ‚ï¼ŒæŒæ¡å¥½è¿™äº›çŸ¥è¯†ï¼Œä½ å°±èƒ½ï¼š

- âœ… ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§
- âœ… æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ
- âœ… ç¼–å†™æ›´å¥å£®çš„åº”ç”¨ç¨‹åº
- âœ… åº”å¯¹å¤æ‚çš„ä¸šåŠ¡éªŒè¯åœºæ™¯

**å­¦ä¹ å»ºè®®**ï¼š
1. å…ˆç†è§£åŸºç¡€æ¦‚å¿µå’Œæµç¨‹
2. åŠ¨æ‰‹å®è·µæ¯ä¸ªçŸ¥è¯†ç‚¹
3. å¤šå†™å¤šç»ƒï¼Œæ€»ç»“ç»éªŒ
4. å…³æ³¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯

> ğŸ’¡ æ¸©é¦¨æç¤ºï¼šæœ¬ç¬”è®°æ¶µç›–äº†è¡¨å•éªŒè¯çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œå»ºè®®ç»“åˆå®é™…é¡¹ç›®ç»ƒä¹ ï¼Œé‡åˆ°é—®é¢˜å¤šæŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œé€æ­¥æå‡å®æˆ˜èƒ½åŠ›ï¼