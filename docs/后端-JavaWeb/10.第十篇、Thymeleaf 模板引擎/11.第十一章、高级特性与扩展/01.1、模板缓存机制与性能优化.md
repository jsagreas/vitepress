---
title: 1ã€æ¨¡æ¿ç¼“å­˜æœºåˆ¶ä¸æ€§èƒ½ä¼˜åŒ–
---
## ğŸ“š ç›®å½•


1. [æ¨¡æ¿ç¼“å­˜æœºåˆ¶åŸç†](#1-æ¨¡æ¿ç¼“å­˜æœºåˆ¶åŸç†)
2. [ç¼“å­˜é…ç½®ç­–ç•¥è¯¦è§£](#2-ç¼“å­˜é…ç½®ç­–ç•¥è¯¦è§£)
3. [å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒç¼“å­˜](#3-å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒç¼“å­˜)
4. [å†…å­˜ä¼˜åŒ–æŠ€å·§](#4-å†…å­˜ä¼˜åŒ–æŠ€å·§)
5. [æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–](#5-æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–)
6. [å¤§æ•°æ®é‡å¤„ç†æ–¹æ¡ˆ](#6-å¤§æ•°æ®é‡å¤„ç†æ–¹æ¡ˆ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ æ¨¡æ¿ç¼“å­˜æœºåˆ¶åŸç†



### 1.1 ä»€ä¹ˆæ˜¯æ¨¡æ¿ç¼“å­˜



> ğŸ’¡ **é€šä¿—ç†è§£**  
> æ¨¡æ¿ç¼“å­˜å°±åƒæ˜¯"èœè°±çš„è®°å¿†"ã€‚ç¬¬ä¸€æ¬¡åšèœæ—¶ä½ è¦ç¿»èœè°±ï¼Œä½†è®°ä½æ­¥éª¤åï¼Œä¸‹æ¬¡å°±èƒ½ç›´æ¥åšï¼Œä¸ç”¨å†ç¿»ä¹¦äº†ã€‚Thymeleafä¹Ÿæ˜¯è¿™æ ·ï¼Œç¬¬ä¸€æ¬¡è¯»å–æ¨¡æ¿åä¼š"è®°ä½"å®ƒï¼Œåç»­ç›´æ¥ä½¿ç”¨è®°å¿†ä¸­çš„ç‰ˆæœ¬ã€‚

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
```
æ¨¡æ¿ç¼“å­˜ = å°†è§£æå¥½çš„æ¨¡æ¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé¿å…é‡å¤è§£æ

å®Œæ•´æµç¨‹å¯¹æ¯”ï¼š

æ— ç¼“å­˜æƒ…å†µï¼š
ç”¨æˆ·è¯·æ±‚ â¡ï¸ è¯»å–æ¨¡æ¿æ–‡ä»¶ â¡ï¸ è§£ææ¨¡æ¿ â¡ï¸ æ¸²æŸ“è¾“å‡º
         ï¼ˆæ¯æ¬¡éƒ½è¦åšï¼‰      ï¼ˆè€—æ—¶ï¼‰

æœ‰ç¼“å­˜æƒ…å†µï¼š
é¦–æ¬¡è¯·æ±‚ â¡ï¸ è¯»å–æ–‡ä»¶ â¡ï¸ è§£æ â¡ï¸ å­˜å…¥ç¼“å­˜ â¡ï¸ æ¸²æŸ“è¾“å‡º
åç»­è¯·æ±‚ â¡ï¸ ç›´æ¥ä»ç¼“å­˜è·å– â¡ï¸ æ¸²æŸ“è¾“å‡ºï¼ˆå¿«é€Ÿï¼ï¼‰
```

### 1.2 ç¼“å­˜çš„å·¥ä½œåŸç†



**ä¸‰æ­¥ç¼“å­˜æµç¨‹**ï¼š

```
æ­¥éª¤1ï¼šæ¨¡æ¿è¯»å–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ templates/user.html â”‚ â† ç£ç›˜æ–‡ä»¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
æ­¥éª¤2ï¼šè§£æä¸ç¼“å­˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨¡æ¿è§£æå¼•æ“        â”‚
â”‚  - è¯­æ³•åˆ†æ          â”‚
â”‚  - æ„å»ºDOMæ ‘        â”‚
â”‚  - ç”Ÿæˆç¼“å­˜å¯¹è±¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
æ­¥éª¤3ï¼šç¼“å­˜å­˜å‚¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å†…å­˜ç¼“å­˜åŒº        â”‚
â”‚  Key: "user.html"   â”‚
â”‚  Value: è§£æç»“æœ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç†è§£**ï¼š
- `è§£æè¿‡ç¨‹`ï¼šæŠŠHTMLæ¨¡æ¿è½¬æ¢æˆThymeleafèƒ½å¿«é€Ÿå¤„ç†çš„å†…éƒ¨æ ¼å¼
- `ç¼“å­˜å¯¹è±¡`ï¼šåŒ…å«äº†æ‰€æœ‰th:å±æ€§çš„å¤„ç†é€»è¾‘ï¼Œä¸éœ€è¦æ¯æ¬¡é‡æ–°åˆ†æ
- `å‘½ä¸­ç¼“å­˜`ï¼šå½“å†æ¬¡è¯·æ±‚åŒä¸€æ¨¡æ¿æ—¶ï¼Œç›´æ¥ç”¨ç°æˆçš„ï¼Œçœå»è§£ææ­¥éª¤

### 1.3 ç¼“å­˜å¸¦æ¥çš„æ€§èƒ½æå‡



**æ€§èƒ½å¯¹æ¯”æ•°æ®**ï¼š

| æ“ä½œç±»å‹ | **æ— ç¼“å­˜** | **æœ‰ç¼“å­˜** | **æå‡å€æ•°** |
|---------|-----------|-----------|-------------|
| ğŸ“„ **æ¨¡æ¿è¯»å–** | æ¯æ¬¡5-10ms | é¦–æ¬¡5-10msï¼Œåç»­0ms | âˆ |
| ğŸ” **æ¨¡æ¿è§£æ** | æ¯æ¬¡20-50ms | é¦–æ¬¡20-50msï¼Œåç»­0ms | âˆ |
| âš¡ **æ€»å“åº”æ—¶é—´** | 30-70ms | é¦–æ¬¡30-70msï¼Œåç»­5-10ms | 3-7å€ |

> ğŸ¯ **å®é™…æ„ä¹‰**  
> å‡è®¾ä½ çš„ç½‘ç«™æ¯ç§’æœ‰100ä¸ªè¯·æ±‚ï¼Œå¯ç”¨ç¼“å­˜åï¼š
> - èŠ‚çœçš„CPUæ—¶é—´ï¼š100è¯·æ±‚ Ã— 30ms = 3ç§’/ç§’
> - å¯æ”¯æ’‘çš„å¹¶å‘é‡ï¼šæå‡3-7å€
> - ç”¨æˆ·ä½“éªŒï¼šé¡µé¢åŠ è½½æ›´å¿«ï¼Œæ›´æµç•…

---

## 2. âš™ï¸ ç¼“å­˜é…ç½®ç­–ç•¥è¯¦è§£



### 2.1 Spring Bootä¸­çš„åŸºç¡€é…ç½®



**application.ymlé…ç½®ç¤ºä¾‹**ï¼š

```yaml
spring:
  thymeleaf:
#    # æ ¸å¿ƒé…ç½®é¡¹
    cache: true              # æ˜¯å¦å¯ç”¨ç¼“å­˜ï¼ˆé»˜è®¤trueï¼‰
    prefix: classpath:/templates/  # æ¨¡æ¿è·¯å¾„
    suffix: .html           # æ¨¡æ¿åç¼€
    mode: HTML              # æ¨¡æ¿æ¨¡å¼
    encoding: UTF-8         # ç¼–ç æ ¼å¼
```

**é…ç½®é¡¹è¯¦ç»†è¯´æ˜**ï¼š

ğŸ”¸ **cacheå‚æ•°**
```
ä½œç”¨ï¼šæ§åˆ¶ç¼“å­˜çš„å¼€å…³
å–å€¼ï¼š
  - trueï¼šå¯ç”¨ç¼“å­˜ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ
  - falseï¼šç¦ç”¨ç¼“å­˜ï¼Œé€‚åˆå¼€å‘ç¯å¢ƒ

å·¥ä½œæœºåˆ¶ï¼š
cache=true  â¡ï¸ æ¨¡æ¿è§£æä¸€æ¬¡ï¼Œæ°¸ä¹…ç¼“å­˜
cache=false â¡ï¸ æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°è§£ææ¨¡æ¿
```

ğŸ”¸ **prefixå’Œsuffix**
```
ä½œç”¨ï¼šå®šä½æ¨¡æ¿æ–‡ä»¶çš„å®Œæ•´è·¯å¾„

å®é™…åº”ç”¨ï¼š
å½“ä½ è¿”å› "user/list" æ—¶ï¼Œå®é™…è·¯å¾„ä¸ºï¼š
classpath:/templates/ + user/list + .html
= /templates/user/list.html
```

### 2.2 ç¼–ç¨‹æ–¹å¼é…ç½®ç¼“å­˜



**è‡ªå®šä¹‰ç¼“å­˜ç®¡ç†å™¨**ï¼š

```java
@Configuration
public class ThymeleafConfig {
    
    @Bean
    public SpringTemplateEngine templateEngine() {
        SpringTemplateEngine engine = new SpringTemplateEngine();
        
        // è®¾ç½®ç¼“å­˜ç®¡ç†å™¨
        engine.setCacheManager(customCacheManager());
        
        return engine;
    }
    
    // è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥
    private ICacheManager customCacheManager() {
        // ä½¿ç”¨é»˜è®¤çš„æ ‡å‡†ç¼“å­˜ç®¡ç†å™¨
        StandardCacheManager cacheManager = 
            new StandardCacheManager();
            
        // è®¾ç½®ç¼“å­˜æ¡ç›®æ•°é‡é™åˆ¶ï¼ˆé»˜è®¤200ï¼‰
        cacheManager.setExpressionCacheMaxSize(500);
        
        return cacheManager;
    }
}
```

**é…ç½®è¯´æ˜**ï¼š

ğŸ’¡ **ExpressionCacheMaxSizeå‚æ•°**
```
å«ä¹‰ï¼šè¡¨è¾¾å¼ç¼“å­˜çš„æœ€å¤§æ¡ç›®æ•°
é»˜è®¤å€¼ï¼š200
æ¨èå€¼ï¼š
  - å°å‹åº”ç”¨ï¼š200-500
  - ä¸­å‹åº”ç”¨ï¼š500-1000
  - å¤§å‹åº”ç”¨ï¼š1000-2000

æ³¨æ„äº‹é¡¹ï¼š
âœ… æ•°å€¼è¶Šå¤§ï¼Œç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜
âŒ æ•°å€¼è¿‡å¤§ï¼Œå ç”¨å†…å­˜å¢åŠ 
ğŸ¯ æ ¹æ®æ¨¡æ¿æ•°é‡å’Œè¡¨è¾¾å¼å¤æ‚åº¦è°ƒæ•´
```

### 2.3 ç»†ç²’åº¦ç¼“å­˜æ§åˆ¶



**é’ˆå¯¹ç‰¹å®šæ¨¡æ¿ç¦ç”¨ç¼“å­˜**ï¼š

```java
@Controller
public class UserController {
    
    @Autowired
    private TemplateEngine templateEngine;
    
    @GetMapping("/dynamic-report")
    public String dynamicReport(Model model) {
        // æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„é¡µé¢ï¼Œä¸´æ—¶ç¦ç”¨ç¼“å­˜
        
        // æ–¹æ³•1ï¼šä½¿ç”¨æ¨¡æ¿è§£æå™¨é…ç½®
        ITemplateResolver resolver = 
            templateEngine.getTemplateResolvers()
                .iterator().next();
        
        if (resolver instanceof SpringResourceTemplateResolver) {
            ((SpringResourceTemplateResolver) resolver)
                .setCacheable(false);
        }
        
        return "report/dynamic";
    }
}
```

> âš ï¸ **ä½¿ç”¨å»ºè®®**  
> ç»†ç²’åº¦æ§åˆ¶é€‚åˆç‰¹æ®Šåœºæ™¯ï¼Œæ¯”å¦‚ï¼š
> - å®æ—¶æ•°æ®æŠ¥è¡¨ï¼ˆè‚¡ç¥¨è¡Œæƒ…ã€ç›‘æ§å¤§å±ï¼‰
> - ä¸ªæ€§åŒ–æ¨èé¡µé¢
> - é¢‘ç¹æ›´æ–°çš„é…ç½®é¡µé¢
>
> å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç»Ÿä¸€é…ç½®æ›´ç®€å•æœ‰æ•ˆ

---

## 3. ğŸ”„ å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒç¼“å­˜



### 3.1 å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆç¦ç”¨ç¼“å­˜ï¼‰



**ä¸ºä»€ä¹ˆå¼€å‘æ—¶è¦ç¦ç”¨ç¼“å­˜ï¼Ÿ**

```
å¼€å‘åœºæ™¯ï¼š
ä½ ä¿®æ”¹äº†æ¨¡æ¿ â¡ï¸ åˆ·æ–°æµè§ˆå™¨
æœŸæœ›ï¼šçœ‹åˆ°æœ€æ–°ä¿®æ”¹
å®é™…ï¼ˆæœ‰ç¼“å­˜ï¼‰ï¼šè¿˜æ˜¯æ—§çš„å†…å®¹ ğŸ˜«
åŸå› ï¼šæµè§ˆå™¨è¯»å–çš„æ˜¯ç¼“å­˜ä¸­çš„æ—§æ¨¡æ¿
```

**å¼€å‘ç¯å¢ƒæœ€ä½³é…ç½®**ï¼š

```yaml
# application-dev.yml

spring:
  thymeleaf:
    cache: false           # å…³é—­ç¼“å­˜
    prefix: classpath:/templates/
    suffix: .html
  
#  # é…åˆçƒ­éƒ¨ç½²ä½¿ç”¨
  devtools:
    restart:
      enabled: true        # å¯ç”¨çƒ­é‡å¯
    livereload:
      enabled: true        # å¯ç”¨å®æ—¶é‡è½½
```

**å¼€å‘å·¥ä½œæµ**ï¼š

```
æ­¥éª¤1ï¼šä¿®æ”¹æ¨¡æ¿
templates/user.html â† æ·»åŠ æ–°å­—æ®µ

æ­¥éª¤2ï¼šä¿å­˜æ–‡ä»¶
IDEè‡ªåŠ¨ä¿å­˜ â¡ï¸ Spring DevToolsæ£€æµ‹åˆ°å˜åŒ–

æ­¥éª¤3ï¼šè‡ªåŠ¨é‡è½½
DevToolsé‡å¯åº”ç”¨ â¡ï¸ æ¸…ç©ºç¼“å­˜

æ­¥éª¤4ï¼šåˆ·æ–°æµè§ˆå™¨
ç«‹å³çœ‹åˆ°æœ€æ–°æ•ˆæœ âœ…
```

### 3.2 ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆå¯ç”¨ç¼“å­˜ï¼‰



**ç”Ÿäº§ç¯å¢ƒé…ç½®è¦ç‚¹**ï¼š

```yaml
# application-prod.yml

spring:
  thymeleaf:
    cache: true            # å¿…é¡»å¼€å¯ï¼
    mode: HTML
    encoding: UTF-8
    
#    # å¯é€‰çš„æ€§èƒ½ä¼˜åŒ–é…ç½®
    check-template-location: false  # ä¸æ£€æŸ¥æ¨¡æ¿æ˜¯å¦å­˜åœ¨
    enable-spring-el-compiler: true # å¯ç”¨SpringELç¼–è¯‘å™¨
```

**é…ç½®é¡¹æ·±åº¦è§£æ**ï¼š

ğŸ”¸ **check-template-location**
```
ä½œç”¨ï¼šæ§åˆ¶æ˜¯å¦æ£€æŸ¥æ¨¡æ¿æ–‡ä»¶å­˜åœ¨æ€§
é»˜è®¤ï¼štrue

è®¾ç½®ä¸ºfalseçš„å¥½å¤„ï¼š
1. å‡å°‘æ–‡ä»¶ç³»ç»ŸIOæ“ä½œ
2. åº”ç”¨å¯åŠ¨æ›´å¿«
3. ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿ä½ç½®å›ºå®šï¼Œæ— éœ€æ£€æŸ¥

å‰ææ¡ä»¶ï¼š
âœ… ç¡®ä¿æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶å·²æ‰“åŒ…
âœ… è·¯å¾„é…ç½®æ­£ç¡®æ— è¯¯
```

ğŸ”¸ **enable-spring-el-compiler**
```
ä½œç”¨ï¼šç¼–è¯‘SpringELè¡¨è¾¾å¼ä¸ºå­—èŠ‚ç 
æ•ˆæœï¼šè¡¨è¾¾å¼æ‰§è¡Œé€Ÿåº¦æå‡2-5å€

é€‚ç”¨åœºæ™¯ï¼š
âœ… æ¨¡æ¿ä¸­æœ‰å¤§é‡å¤æ‚è¡¨è¾¾å¼
âœ… è¡¨è¾¾å¼é‡å¤æ‰§è¡Œå¤šæ¬¡
âœ… å¯¹æ€§èƒ½è¦æ±‚è‹›åˆ»

æ³¨æ„äº‹é¡¹ï¼š
âš ï¸ ç¼–è¯‘æœ‰ä¸€å®šå¼€é”€ï¼Œé¦–æ¬¡å¯åŠ¨ç¨æ…¢
âš ï¸ é€‚åˆé•¿æœŸè¿è¡Œçš„åº”ç”¨
```

### 3.3 ç¯å¢ƒåˆ‡æ¢æœ€ä½³å®è·µ



**ä½¿ç”¨Spring Profileså®ç°æ— ç¼åˆ‡æ¢**ï¼š

```
é¡¹ç›®é…ç½®æ–‡ä»¶ç»“æ„ï¼š
src/main/resources/
  â”œâ”€â”€ application.yml          # é€šç”¨é…ç½®
  â”œâ”€â”€ application-dev.yml      # å¼€å‘ç¯å¢ƒ
  â”œâ”€â”€ application-test.yml     # æµ‹è¯•ç¯å¢ƒ
  â””â”€â”€ application-prod.yml     # ç”Ÿäº§ç¯å¢ƒ

å¯åŠ¨å‘½ä»¤ï¼š
å¼€å‘ï¼šjava -jar app.jar --spring.profiles.active=dev
æµ‹è¯•ï¼šjava -jar app.jar --spring.profiles.active=test
ç”Ÿäº§ï¼šjava -jar app.jar --spring.profiles.active=prod
```

**é…ç½®ç»§æ‰¿ç¤ºä¾‹**ï¼š

```yaml
# application.ymlï¼ˆåŸºç¡€é…ç½®ï¼‰

spring:
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    mode: HTML
    encoding: UTF-8

---
# application-dev.ymlï¼ˆå¼€å‘è¦†ç›–ï¼‰

spring:
  thymeleaf:
    cache: false  # åªè¦†ç›–è¿™ä¸€é¡¹

---
# application-prod.ymlï¼ˆç”Ÿäº§è¦†ç›–ï¼‰

spring:
  thymeleaf:
    cache: true
    check-template-location: false
    enable-spring-el-compiler: true
```

> ğŸ¯ **æœ€ä½³å®è·µ**
> - åŸºç¡€é…ç½®æ”¾åœ¨ `application.yml`
> - ç¯å¢ƒå·®å¼‚æ”¾åœ¨ `application-{profile}.yml`
> - ä½¿ç”¨ç¯å¢ƒå˜é‡æ§åˆ¶æ¿€æ´»çš„profile
> - é¿å…åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ç¯å¢ƒç›¸å…³é…ç½®

---

## 4. ğŸ’¾ å†…å­˜ä¼˜åŒ–æŠ€å·§



### 4.1 ç¼“å­˜å†…å­˜å ç”¨åˆ†æ



**ç†è§£ç¼“å­˜çš„å†…å­˜æ¶ˆè€—**ï¼š

```
å•ä¸ªæ¨¡æ¿ç¼“å­˜å ç”¨ä¼°ç®—ï¼š

å°å‹æ¨¡æ¿ï¼ˆ<5KBï¼‰ï¼š
  æ–‡ä»¶å¤§å°: 3KB
  è§£æåç¼“å­˜: çº¦10-15KB
  å†…å­˜å ç”¨: 5å€å·¦å³

ä¸­å‹æ¨¡æ¿ï¼ˆ5-20KBï¼‰ï¼š
  æ–‡ä»¶å¤§å°: 15KB
  è§£æåç¼“å­˜: çº¦50-80KB
  å†…å­˜å ç”¨: 4-5å€

å¤§å‹æ¨¡æ¿ï¼ˆ>20KBï¼‰ï¼š
  æ–‡ä»¶å¤§å°: 50KB
  è§£æåç¼“å­˜: çº¦150-250KB
  å†…å­˜å ç”¨: 3-5å€
```

**å®é™…æ¡ˆä¾‹åˆ†æ**ï¼š

```
å‡è®¾ä½ çš„åº”ç”¨æœ‰ï¼š
- 100ä¸ªæ¨¡æ¿æ–‡ä»¶
- å¹³å‡æ¯ä¸ª10KB
- å¹³å‡è§£æå40KB

æ€»å†…å­˜å ç”¨ = 100 Ã— 40KB = 4MB

ç»“è®ºï¼š
âœ… æ¨¡æ¿ç¼“å­˜å ç”¨å†…å­˜å¾ˆå°
âœ… ç›¸æ¯”æ€§èƒ½æå‡ï¼Œå†…å­˜å¼€é”€å¯ä»¥æ¥å—
âœ… é™¤éæ¨¡æ¿æå¤šï¼ˆ>1000ä¸ªï¼‰ï¼Œå¦åˆ™ä¸å¿…æ‹…å¿ƒ
```

### 4.2 æ§åˆ¶ç¼“å­˜å¤§å°



**è®¾ç½®ç¼“å­˜æ¡ç›®é™åˆ¶**ï¼š

```java
@Configuration
public class CacheOptimizationConfig {
    
    @Bean
    public SpringTemplateEngine templateEngine() {
        SpringTemplateEngine engine = new SpringTemplateEngine();
        
        // åˆ›å»ºç¼“å­˜ç®¡ç†å™¨
        StandardCacheManager cacheManager = 
            new StandardCacheManager();
        
        // è®¾ç½®æ¨¡æ¿ç¼“å­˜æœ€å¤§æ•°é‡
        cacheManager.setTemplateCacheMaxSize(100);
        
        // è®¾ç½®è¡¨è¾¾å¼ç¼“å­˜æœ€å¤§æ•°é‡
        cacheManager.setExpressionCacheMaxSize(500);
        
        engine.setCacheManager(cacheManager);
        
        return engine;
    }
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | **å«ä¹‰** | **é»˜è®¤å€¼** | **æ¨èèŒƒå›´** |
|-----|---------|-----------|-------------|
| `TemplateCacheMaxSize` | æ¨¡æ¿ç¼“å­˜æœ€å¤§æ¡ç›®æ•° | 200 | 50-500 |
| `ExpressionCacheMaxSize` | è¡¨è¾¾å¼ç¼“å­˜æœ€å¤§æ¡ç›®æ•° | 200 | 200-2000 |

ğŸ’¡ **è°ƒæ•´å»ºè®®**ï¼š
```
å°å‹åº”ç”¨ï¼ˆ<50ä¸ªæ¨¡æ¿ï¼‰ï¼š
  TemplateCacheMaxSize: 50
  ExpressionCacheMaxSize: 200

ä¸­å‹åº”ç”¨ï¼ˆ50-200ä¸ªæ¨¡æ¿ï¼‰ï¼š
  TemplateCacheMaxSize: 200ï¼ˆé»˜è®¤ï¼‰
  ExpressionCacheMaxSize: 500

å¤§å‹åº”ç”¨ï¼ˆ>200ä¸ªæ¨¡æ¿ï¼‰ï¼š
  TemplateCacheMaxSize: 500
  ExpressionCacheMaxSize: 1000-2000
```

### 4.3 æ¸…ç†ç¼“å­˜ç­–ç•¥



**æ‰‹åŠ¨æ¸…ç†ç¼“å­˜**ï¼š

```java
@Service
public class TemplateCacheService {
    
    @Autowired
    private SpringTemplateEngine templateEngine;
    
    // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
    public void clearAllCache() {
        templateEngine.clearTemplateCache();
    }
    
    // æ¸…ç©ºç‰¹å®šæ¨¡æ¿ç¼“å­˜
    public void clearTemplateCache(String templateName) {
        ITemplateResolver resolver = 
            templateEngine.getTemplateResolvers()
                .iterator().next();
        
        if (resolver instanceof ICacheableTemplateResolver) {
            ((ICacheableTemplateResolver) resolver)
                .clearCacheFor(templateName);
        }
    }
}
```

**åº”ç”¨åœºæ™¯**ï¼š

```
åœºæ™¯1ï¼šæ¨¡æ¿çƒ­æ›´æ–°
ç”¨æˆ·ä¸Šä¼ æ–°æ¨¡æ¿ â¡ï¸ æ¸…ç†å¯¹åº”ç¼“å­˜ â¡ï¸ ä¸‹æ¬¡è¯·æ±‚ä½¿ç”¨æ–°æ¨¡æ¿

åœºæ™¯2ï¼šå®šæ—¶æ¸…ç†
æ¯å¤©å‡Œæ™¨ â¡ï¸ æ¸…ç©ºæ‰€æœ‰ç¼“å­˜ â¡ï¸ é‡Šæ”¾å†…å­˜

åœºæ™¯3ï¼šæ‰‹åŠ¨ç®¡ç†
ç®¡ç†åå°æä¾›æ¸…ç†æŒ‰é’® â¡ï¸ è¿ç»´äººå‘˜æ‰‹åŠ¨æ¸…ç† â¡ï¸ é—®é¢˜æ’æŸ¥
```

---

## 5. âš¡ æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–



### 5.1 å‡å°‘è¡¨è¾¾å¼å¤æ‚åº¦



**é—®é¢˜ç¤ºä¾‹**ï¼š

```html
<!-- âŒ æ€§èƒ½å·®ï¼šå¤æ‚çš„é“¾å¼è°ƒç”¨ -->
<div th:text="${user.getAddress().getCity().getName().toUpperCase()}">
</div>

<!-- âŒ æ€§èƒ½å·®ï¼šå¾ªç¯ä¸­çš„å¤æ‚è®¡ç®— -->
<tr th:each="item : ${items}">
    <td th:text="${item.price * item.quantity * (1 - item.discount / 100)}">
    </td>
</tr>
```

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

```java
// âœ… åœ¨Controllerä¸­é¢„å¤„ç†
@GetMapping("/user/profile")
public String userProfile(Model model) {
    User user = userService.getCurrentUser();
    
    // æå‰è®¡ç®—å¥½å¤æ‚é€»è¾‘
    String cityName = user.getAddress()
        .getCity()
        .getName()
        .toUpperCase();
    
    model.addAttribute("user", user);
    model.addAttribute("cityName", cityName);
    
    return "user/profile";
}
```

```html
<!-- âœ… æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨ -->
<div th:text="${cityName}"></div>
```

> ğŸ’¡ **ä¼˜åŒ–åŸåˆ™**  
> **èƒ½åœ¨Javaä¸­ç®—çš„ï¼Œä¸è¦åœ¨æ¨¡æ¿ä¸­ç®—**
> - Javaä»£ç æ‰§è¡Œé€Ÿåº¦å¿«
> - æ˜“äºè°ƒè¯•å’Œæµ‹è¯•
> - æ¨¡æ¿ä¿æŒç®€æ´

### 5.2 é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º



**é—®é¢˜ä»£ç **ï¼š

```html
<!-- âŒ æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„SimpleDateFormat -->
<span th:text="${#dates.format(user.createTime, 'yyyy-MM-dd HH:mm:ss')}">
</span>
```

**ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šä½¿ç”¨å·¥å…·ç±»**

```java
@Component
public class DateFormatUtil {
    
    private static final DateTimeFormatter FORMATTER = 
        DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
    
    public String format(LocalDateTime dateTime) {
        return dateTime.format(FORMATTER);
    }
}
```

```html
<!-- âœ… ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼åŒ–å™¨ -->
<span th:text="${@dateFormatUtil.format(user.createTime)}"></span>
```

**ä¼˜åŒ–æ–¹æ¡ˆ2ï¼šé¢„æ ¼å¼åŒ–**

```java
public class UserVO {
    private String username;
    private LocalDateTime createTime;
    private String createTimeStr;  // é¢„æ ¼å¼åŒ–çš„æ—¶é—´
    
    public UserVO(User user) {
        this.username = user.getUsername();
        this.createTime = user.getCreateTime();
        this.createTimeStr = createTime.format(
            DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")
        );
    }
}
```

```html
<!-- âœ… ç›´æ¥ä½¿ç”¨æ ¼å¼åŒ–å¥½çš„å­—ç¬¦ä¸² -->
<span th:text="${user.createTimeStr}"></span>
```

### 5.3 ç‰‡æ®µå¤ç”¨ä¼˜åŒ–



**ä¼˜åŒ–å‰çš„é‡å¤ä»£ç **ï¼š

```html
<!-- page1.html -->
<div class="header">
    <h1>é¡µé¢1</h1>
    <nav>...</nav>
</div>

<!-- page2.html -->
<div class="header">
    <h1>é¡µé¢2</h1>
    <nav>...</nav>
</div>
```

**ä¼˜åŒ–åçš„ç‰‡æ®µå¤ç”¨**ï¼š

```html
<!-- fragments/common.html -->
<div th:fragment="header(title)" class="header">
    <h1 th:text="${title}"></h1>
    <nav>...</nav>
</div>

<!-- page1.html -->
<div th:replace="~{fragments/common :: header('é¡µé¢1')}"></div>

<!-- page2.html -->
<div th:replace="~{fragments/common :: header('é¡µé¢2')}"></div>
```

**æ€§èƒ½æå‡åˆ†æ**ï¼š

```
ä¼˜åŒ–æ•ˆæœï¼š
1. ç‰‡æ®µåªè§£æä¸€æ¬¡ï¼Œå¤šæ¬¡å¤ç”¨
2. å‡å°‘æ¨¡æ¿æ–‡ä»¶å¤§å°
3. é™ä½è§£ææ—¶é—´

å®æµ‹æ•°æ®ï¼š
- ä¼˜åŒ–å‰ï¼šæ¯ä¸ªé¡µé¢è§£æ50ms
- ä¼˜åŒ–åï¼šç‰‡æ®µè§£æ30ms + é¡µé¢è§£æ20ms = 50msï¼ˆé¦–æ¬¡ï¼‰
        åç»­é¡µé¢ä»…éœ€15msï¼ˆç‰‡æ®µå·²ç¼“å­˜ï¼‰
```

---

## 6. ğŸ“Š å¤§æ•°æ®é‡å¤„ç†æ–¹æ¡ˆ



### 6.1 åˆ†é¡µæ¸²æŸ“ç­–ç•¥



**é—®é¢˜åœºæ™¯**ï¼š

```
ä¸€æ¬¡æ€§æ¸²æŸ“10000æ¡æ•°æ®ï¼š
- æ¨¡æ¿æ¸²æŸ“è€—æ—¶ï¼š2-3ç§’
- æµè§ˆå™¨è§£æè€—æ—¶ï¼š1-2ç§’
- ç”¨æˆ·ä½“éªŒï¼šé¡µé¢å¡é¡¿ã€æ— å“åº”
```

**è§£å†³æ–¹æ¡ˆï¼šæœåŠ¡ç«¯åˆ†é¡µ**

```java
@GetMapping("/users")
public String listUsers(
    @RequestParam(defaultValue = "1") int page,
    @RequestParam(defaultValue = "20") int size,
    Model model
) {
    // åªæŸ¥è¯¢å½“å‰é¡µæ•°æ®
    Page<User> userPage = userService.findAll(
        PageRequest.of(page - 1, size)
    );
    
    model.addAttribute("users", userPage.getContent());
    model.addAttribute("totalPages", userPage.getTotalPages());
    model.addAttribute("currentPage", page);
    
    return "user/list";
}
```

```html
<!-- æ¨¡æ¿ä¸­åªæ¸²æŸ“å½“å‰é¡µ -->
<tr th:each="user : ${users}">
    <td th:text="${user.username}"></td>
    <td th:text="${user.email}"></td>
</tr>

<!-- åˆ†é¡µæ§ä»¶ -->
<div class="pagination">
    <a th:href="@{/users(page=${currentPage - 1})}" 
       th:if="${currentPage > 1}">ä¸Šä¸€é¡µ</a>
    <a th:href="@{/users(page=${currentPage + 1})}" 
       th:if="${currentPage < totalPages}">ä¸‹ä¸€é¡µ</a>
</div>
```

### 6.2 æ‡’åŠ è½½ä¸Ajaxæ¸²æŸ“



**åœºæ™¯ï¼šæ— é™æ»šåŠ¨åˆ—è¡¨**

```html
<!-- åˆå§‹åªæ¸²æŸ“ä¸€éƒ¨åˆ†æ•°æ® -->
<div id="user-list">
    <div th:each="user : ${users}" class="user-item">
        <span th:text="${user.username}"></span>
    </div>
</div>

<script>
// æ»šåŠ¨åˆ°åº•éƒ¨åŠ è½½æ›´å¤š
let page = 2;
window.addEventListener('scroll', () => {
    if (isScrolledToBottom()) {
        fetch(`/api/users?page=${page++}`)
            .then(res => res.text())
            .then(html => {
                document.getElementById('user-list')
                    .innerHTML += html;
            });
    }
});
</script>
```

**åç«¯è¿”å›HTMLç‰‡æ®µ**ï¼š

```java
@GetMapping("/api/users")
public String loadMoreUsers(
    @RequestParam int page,
    Model model
) {
    List<User> users = userService.findByPage(page, 20);
    model.addAttribute("users", users);
    
    // åªè¿”å›ç‰‡æ®µï¼Œä¸è¿”å›å®Œæ•´é¡µé¢
    return "fragments/user-items :: user-item-list";
}
```

```html
<!-- fragments/user-items.html -->
<div th:fragment="user-item-list">
    <div th:each="user : ${users}" class="user-item">
        <span th:text="${user.username}"></span>
    </div>
</div>
```

### 6.3 å¼‚æ­¥æ¸²æŸ“ä¼˜åŒ–



**å¹¶è¡ŒåŠ è½½ä¸åŒåŒºå—**ï¼š

```java
@GetMapping("/dashboard")
public String dashboard(Model model) {
    // åªåŠ è½½å¿…è¦çš„æ ¸å¿ƒæ•°æ®
    model.addAttribute("user", getCurrentUser());
    
    // å…¶ä»–æ•°æ®å¼‚æ­¥åŠ è½½
    return "dashboard";
}

@GetMapping("/dashboard/stats")
@ResponseBody
public String getStats() {
    // å¼‚æ­¥è¿”å›ç»Ÿè®¡æ•°æ®HTMLç‰‡æ®µ
    Statistics stats = statsService.getStats();
    // ä½¿ç”¨æ¨¡æ¿å¼•æ“æ¸²æŸ“ç‰‡æ®µ
    return renderFragment("dashboard-stats", stats);
}
```

```html
<!-- dashboard.html -->
<div class="user-info" th:text="${user.name}"></div>

<div id="stats-container">
    <div class="loading">åŠ è½½ä¸­...</div>
</div>

<script>
// é¡µé¢åŠ è½½åå¼‚æ­¥è·å–ç»Ÿè®¡æ•°æ®
fetch('/dashboard/stats')
    .then(res => res.text())
    .then(html => {
        document.getElementById('stats-container').innerHTML = html;
    });
</script>
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | **é¦–å±åŠ è½½** | **æ€»åŠ è½½æ—¶é—´** | **ç”¨æˆ·ä½“éªŒ** |
|-----|------------|--------------|-------------|
| åŒæ­¥å…¨é‡åŠ è½½ | 3000ms | 3000ms | â­â­ é•¿æ—¶é—´ç™½å± |
| æ ¸å¿ƒæ•°æ®ä¼˜å…ˆ | 500ms | 2000ms | â­â­â­â­ å¿«é€Ÿå¯äº¤äº’ |
| å¼‚æ­¥åˆ†æ‰¹åŠ è½½ | 300ms | 2500ms | â­â­â­â­â­ æ¸è¿›å¼å‘ˆç° |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 7.1 ç¼“å­˜æœºåˆ¶è¦ç‚¹



```
ğŸ”¸ ç¼“å­˜æœ¬è´¨
å°†è§£æå¥½çš„æ¨¡æ¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé¿å…é‡å¤è§£æ
é¦–æ¬¡è¯·æ±‚æ…¢ï¼Œåç»­è¯·æ±‚å¿«

ğŸ”¸ å¼€å‘ç¯å¢ƒ
cache: false  â¡ï¸ ä¿®æ”¹æ¨¡æ¿ç«‹å³ç”Ÿæ•ˆ
é…åˆDevTools  â¡ï¸ è‡ªåŠ¨é‡è½½

ğŸ”¸ ç”Ÿäº§ç¯å¢ƒ
cache: true   â¡ï¸ æ€§èƒ½æå‡3-7å€
check-template-location: false â¡ï¸ å‡å°‘IO
enable-spring-el-compiler: true â¡ï¸ è¡¨è¾¾å¼åŠ é€Ÿ
```

### 7.2 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹



**ä¼˜åŒ–ä¼˜å…ˆçº§æ’åº**ï¼š

```
â­â­â­â­â­ å¿…é¡»åš
1. å¯ç”¨ç”Ÿäº§ç¯å¢ƒç¼“å­˜
2. ä½¿ç”¨åˆ†é¡µè€Œéå…¨é‡åŠ è½½
3. å¤æ‚è®¡ç®—æ”¾åœ¨Controller

â­â­â­â­ æ¨èåš
4. è¡¨è¾¾å¼é¢„è®¡ç®—
5. ç‰‡æ®µå¤ç”¨
6. å¼‚æ­¥åŠ è½½éæ ¸å¿ƒæ•°æ®

â­â­â­ å¯é€‰åš
7. è°ƒæ•´ç¼“å­˜å¤§å°
8. å®šæœŸæ¸…ç†ç¼“å­˜
9. ä½¿ç”¨SpringELç¼–è¯‘å™¨
```

### 7.3 å†…å­˜ç®¡ç†è¦ç‚¹



**å†…å­˜å ç”¨ä¼°ç®—å…¬å¼**ï¼š

```
æ€»ç¼“å­˜å†…å­˜ â‰ˆ æ¨¡æ¿æ•°é‡ Ã— å¹³å‡æ¨¡æ¿å¤§å° Ã— 4

ç¤ºä¾‹è®¡ç®—ï¼š
100ä¸ªæ¨¡æ¿ Ã— 10KB Ã— 4 = 4MB

ç»“è®ºï¼š
âœ… æ¨¡æ¿ç¼“å­˜å ç”¨å¾ˆå°ï¼ˆé€šå¸¸<10MBï¼‰
âœ… å†…å­˜æ¢æ€§èƒ½ï¼Œéå¸¸åˆ’ç®—
âŒ é™¤éæ¨¡æ¿æå¤šï¼Œå¦åˆ™ä¸å¿…æ‹…å¿ƒå†…å­˜
```

### 7.4 å¤§æ•°æ®å¤„ç†è¦ç‚¹



**æ•°æ®é‡åˆ†çº§å¤„ç†**ï¼š

```
ğŸ“Š æ•°æ®é‡çº§åˆ«å¤„ç†ç­–ç•¥

å°é‡ï¼ˆ<100æ¡ï¼‰ï¼š
  âœ… ç›´æ¥å…¨é‡æ¸²æŸ“
  âœ… ç®€å•å¿«é€Ÿ

ä¸­é‡ï¼ˆ100-1000æ¡ï¼‰ï¼š
  âœ… æœåŠ¡ç«¯åˆ†é¡µ
  âœ… æ¯é¡µ20-50æ¡

å¤§é‡ï¼ˆ>1000æ¡ï¼‰ï¼š
  âœ… åˆ†é¡µ + æ‡’åŠ è½½
  âœ… è™šæ‹Ÿæ»šåŠ¨
  âœ… å¼‚æ­¥åŠ è½½

æµ·é‡ï¼ˆ>10000æ¡ï¼‰ï¼š
  âœ… æœç´¢è¿‡æ»¤ + åˆ†é¡µ
  âœ… å‰ç«¯è¡¨æ ¼è™šæ‹ŸåŒ–
  âœ… è€ƒè™‘ä½¿ç”¨å‰ç«¯æ¡†æ¶
```

### 7.5 æœ€ä½³å®è·µæ€»ç»“



> ğŸ¯ **æ ¸å¿ƒåŸåˆ™**

**å¼€å‘é˜¶æ®µ**ï¼š
```
âœ… å…³é—­ç¼“å­˜ï¼Œæ–¹ä¾¿è°ƒè¯•
âœ… ä½¿ç”¨DevToolsçƒ­é‡è½½
âœ… å…³æ³¨æ¨¡æ¿è¯­æ³•æ­£ç¡®æ€§
```

**ä¸Šçº¿å‰**ï¼š
```
âœ… æ£€æŸ¥ç”Ÿäº§é…ç½®ï¼šcache=true
âœ… å‹åŠ›æµ‹è¯•éªŒè¯æ€§èƒ½
âœ… ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```
âœ… ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
âœ… å®šæœŸæŸ¥çœ‹å†…å­˜å ç”¨
âœ… å¼‚å¸¸æ—¶è€ƒè™‘æ¸…ç†ç¼“å­˜
```

**æ€§èƒ½ä¼˜åŒ–**ï¼š
```
âœ… ä¼˜å…ˆä¼˜åŒ–æ•°æ®æŸ¥è¯¢ï¼ˆæ•°æ®åº“å±‚ï¼‰
âœ… å…¶æ¬¡ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘ï¼ˆServiceå±‚ï¼‰
âœ… æœ€åä¼˜åŒ–æ¨¡æ¿æ¸²æŸ“ï¼ˆViewå±‚ï¼‰
âœ… è®°ä½ï¼š80%çš„æ€§èƒ½é—®é¢˜åœ¨æ•°æ®å±‚
```

---

# ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€



```
æ¨¡æ¿ç¼“å­˜ææ€§èƒ½ï¼Œå¼€å‘å…³é—­ç”Ÿäº§å¼€
å¤æ‚é€»è¾‘Javaç®—ï¼Œæ¨¡æ¿åªç®¡æŠŠæ´»å±•
åˆ†é¡µå¼‚æ­¥å¤„ç†å¤§æ•°æ®ï¼Œç‰‡æ®µå¤ç”¨å‡é‡å¤
ç›‘æ§ä¼˜åŒ–æŒç»­åšï¼Œæ€§èƒ½ç¨³å®šç”¨æˆ·ä¹
```

**å…³é”®æ•°å­—è®°å¿†**ï¼š
- `3-7å€`ï¼šç¼“å­˜å¸¦æ¥çš„æ€§èƒ½æå‡
- `4å€`ï¼šè§£æåæ¨¡æ¿çš„å†…å­˜å ç”¨ç³»æ•°
- `20-50`ï¼šæ¨èçš„åˆ†é¡µå¤§å°
- `200`ï¼šé»˜è®¤çš„ç¼“å­˜æ¡ç›®æ•°

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**  
> 1. å…ˆåœ¨å¼€å‘ç¯å¢ƒå®éªŒï¼Œç†è§£ç¼“å­˜å¼€å…³çš„æ•ˆæœ
> 2. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·è§‚å¯ŸåŠ è½½æ—¶é—´
> 3. ç”¨JMeteråšå‹åŠ›æµ‹è¯•ï¼Œå¯¹æ¯”æœ‰æ— ç¼“å­˜çš„å·®å¼‚
> 4. é€æ­¥åº”ç”¨ä¼˜åŒ–æŠ€å·§ï¼Œæ¯æ¬¡åªæ”¹ä¸€ä¸ªåœ°æ–¹
> 5. è®°å½•ä¼˜åŒ–å‰åçš„æ€§èƒ½æ•°æ®ï¼Œé‡åŒ–æå‡æ•ˆæœ