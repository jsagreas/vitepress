---
title: 3、Thymeleaf布局方言使用
---
## 📚 目录

1. [Layout Dialect布局方言介绍](#1-Layout-Dialect布局方言介绍)
2. [装饰器模式在模板中的应用](#2-装饰器模式在模板中的应用)
3. [layout:decorator装饰器详解](#3-layoutdecorator装饰器详解)
4. [layout:fragment内容片段管理](#4-layoutfragment内容片段管理)
5. [layout:title标题动态设置](#5-layouttitle标题动态设置)
6. [统一页面结构设计](#6-统一页面结构设计)
7. [布局继承机制深入理解](#7-布局继承机制深入理解)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎨 Layout Dialect布局方言介绍


### 1.1 什么是Layout Dialect

🎯 **通俗理解**：Layout Dialect就像"页面装修的模板"

```
生活中的类比：
装修房子的标准化方案
- 基础户型：统一的房屋结构（布局模板）
- 个性装修：每个房间的独特装饰（页面内容）
- 公共区域：客厅、厨房等共享空间（公共布局）

网页开发：
基础布局 → 定义页面的骨架结构
内容填充 → 每个页面的具体内容
公共部分 → 导航栏、页脚等共用元素
```

**🔸 为什么需要Layout Dialect**
```
传统开发的痛点：
❌ 每个页面都要写完整的HTML结构
❌ 头部、导航、页脚等重复代码太多
❌ 修改公共部分需要改很多文件
❌ 代码维护成本高，容易出错

Layout Dialect的优势：
✅ 定义一个布局模板，所有页面复用
✅ 只写页面独特的内容部分
✅ 修改布局模板，所有页面自动更新
✅ 代码简洁，维护方便
```

### 1.2 Layout Dialect的核心概念

**📋 三个关键角色**

```
角色分工：

1. 布局模板（Layout Template）
   作用：定义页面的整体结构
   包含：头部、导航、页脚等公共部分
   示例：layout.html（主布局文件）

2. 内容页面（Content Page）
   作用：提供具体的页面内容
   包含：独特的业务内容和数据
   示例：user-list.html、product-detail.html

3. 片段占位符（Fragment Placeholders）
   作用：在布局中预留内容插入位置
   使用：layout:fragment定义填充区域
   示例：主内容区、侧边栏等
```

**🔍 工作流程图示**
```
页面渲染流程：

内容页面（user-list.html）
    │
    ├─ 声明使用哪个布局模板
    │  layout:decorate="~{layout}"
    │
    ├─ 定义要填充的内容片段
    │  layout:fragment="content"
    │
    ↓
布局模板（layout.html）
    │
    ├─ 提供整体页面结构
    │  <header>、<nav>、<footer>
    │
    ├─ 接收内容片段填充
    │  layout:fragment="content" ← 这里会被替换
    │
    ↓
最终渲染的完整页面
```

### 1.3 引入Layout Dialect依赖

**🔧 Maven项目配置**

```xml
<!-- pom.xml 添加依赖 -->
<dependency>
    <groupId>nz.net.ultraq.thymeleaf</groupId>
    <artifactId>thymeleaf-layout-dialect</artifactId>
    <version>3.1.0</version>
</dependency>
```

**⚙️ Spring Boot自动配置**
```
Spring Boot 2.x 及以上版本：
- 自动集成Layout Dialect
- 无需额外配置即可使用
- 命名空间：xmlns:layout

手动配置示例（非Spring Boot）：
TemplateEngine templateEngine = new TemplateEngine();
templateEngine.addDialect(new LayoutDialect());
```

---

## 2. 🏗️ 装饰器模式在模板中的应用


### 2.1 装饰器模式理解

🎯 **设计模式通俗讲解**

```
装饰器模式的生活例子：

基础手机 → 贴膜 → 手机壳 → 挂绳
   │        │      │      │
  原功能  +保护  +防摔  +防丢

每一层都是对原有物品的"装饰"，不改变核心功能

网页布局的装饰器：
基础内容 → 添加布局 → 添加样式 → 添加交互
   │         │         │         │
  业务数据   页面结构   视觉效果   用户体验
```

**🔸 Thymeleaf中的装饰器模式**
```
装饰流程：

原始内容页面：
<div>
  <h1>用户列表</h1>
  <table>...</table>
</div>

↓ 应用布局装饰器

装饰后的完整页面：
<!DOCTYPE html>
<html>
<head>
  <title>用户列表</title>
  <link rel="stylesheet" href="...">
</head>
<body>
  <header>网站头部</header>
  <nav>导航栏</nav>
  
  <main>
    <div>  ← 原始内容插入这里
      <h1>用户列表</h1>
      <table>...</table>
    </div>
  </main>
  
  <footer>网站页脚</footer>
</body>
</html>
```

### 2.2 装饰器的优势对比

**📊 传统方式 vs 装饰器方式**

| 对比项 | **传统include方式** | **装饰器方式** |
|--------|-------------------|---------------|
| 🔸 **代码组织** | `分散的片段拼接` | `集中的布局管理` |
| 🔸 **页面结构** | `每个页面都要完整写` | `只写内容部分` |
| 🔸 **维护成本** | `修改公共部分要改多处` | `修改布局文件即可` |
| 🔸 **灵活性** | `片段独立性强` | `结构继承性强` |
| 🔸 **适用场景** | `小组件复用` | `整体布局复用` |

**💡 实际应用选择**
```
使用include的场景：
- 小的可重用组件（按钮、卡片）
- 不需要整体布局的片段
- 灵活插入任意位置的内容

使用装饰器的场景：
- 统一的页面布局结构
- 多页面共享相同框架
- 需要布局继承的情况
```

---

## 3. 🎭 layout:decorator装饰器详解


### 3.1 装饰器的基本使用

**🔧 内容页面中声明装饰器**

```html
<!-- user-list.html 内容页面 -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<!--  
  layout:decorate 的作用：
  1. 告诉Thymeleaf使用哪个布局模板
  2. ~{layout/main} 表示使用 templates/layout/main.html
  3. 当前页面的内容会被装饰到布局中
-->

<head>
  <title>用户列表</title>
</head>

<body>
  <!-- 这里定义要填充到布局中的内容 -->
  <div layout:fragment="content">
    <h1>用户管理</h1>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>姓名</th>
          <th>邮箱</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="user : ${users}">
          <td th:text="${user.id}">1</td>
          <td th:text="${user.name}">张三</td>
          <td th:text="${user.email}">zhang@example.com</td>
        </tr>
      </tbody>
    </table>
  </div>
</body>
</html>
```

**📝 装饰器路径说明**
```
路径写法规范：

1. 相对路径：
   layout:decorate="~{layout/main}"
   → 查找 templates/layout/main.html

2. 绝对路径：
   layout:decorate="~{/layouts/base}"
   → 从templates根目录开始

3. 带扩展名（可选）：
   layout:decorate="~{layout/main.html}"
   → 明确指定文件扩展名

推荐做法：
- 使用相对路径，简洁明了
- 省略.html扩展名
- 布局文件统一放在layout目录
```

### 3.2 布局模板的定义

**🏛️ 创建主布局模板**

```html
<!-- layout/main.html 布局模板 -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- 标题会被内容页面替换 -->
  <title layout:title-pattern="$CONTENT_TITLE - 我的网站">默认标题</title>
  
  <!-- 公共CSS -->
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
  <link rel="stylesheet" th:href="@{/css/common.css}">
  
  <!-- 内容页面可以添加额外的head内容 -->
  <th:block layout:fragment="extra-css"></th:block>
</head>

<body>
  <!-- 网站头部 - 所有页面共享 -->
  <header class="site-header">
    <div class="container">
      <h1>我的网站</h1>
      <p>欢迎使用系统</p>
    </div>
  </header>

  <!-- 导航栏 - 所有页面共享 -->
  <nav class="navbar">
    <div class="container">
      <a th:href="@{/}">首页</a>
      <a th:href="@{/users}">用户管理</a>
      <a th:href="@{/products}">商品管理</a>
      <a th:href="@{/orders}">订单管理</a>
    </div>
  </nav>

  <!-- 主内容区域 - 会被内容页面替换 -->
  <main class="main-content">
    <div class="container">
      <!-- 这是内容插入点 -->
      <div layout:fragment="content">
        <!-- 
          默认内容（如果内容页面没有提供，显示这个）
          通常内容页面会替换这里
        -->
        <p>页面内容加载中...</p>
      </div>
    </div>
  </main>

  <!-- 侧边栏 - 可选的内容区域 -->
  <aside class="sidebar">
    <div layout:fragment="sidebar">
      <!-- 默认侧边栏内容 -->
      <div class="widget">
        <h3>默认侧边栏</h3>
      </div>
    </div>
  </aside>

  <!-- 网站页脚 - 所有页面共享 -->
  <footer class="site-footer">
    <div class="container">
      <p>&copy; 2024 我的网站. All rights reserved.</p>
    </div>
  </footer>

  <!-- 公共JavaScript -->
  <script th:src="@{/js/jquery.min.js}"></script>
  <script th:src="@{/js/bootstrap.min.js}"></script>
  
  <!-- 内容页面可以添加额外的JS -->
  <th:block layout:fragment="extra-js"></th:block>
</body>
</html>
```

### 3.3 多层装饰器嵌套

**🔗 复杂布局的继承结构**

```
布局继承层次：

基础布局（base.html）
    │
    ├─ 定义最基础的HTML结构
    ├─ 包含通用meta标签、CDN资源
    │
    ↓
主布局（main.html）
    │
    ├─ 继承自base.html
    ├─ 添加网站头部、导航、页脚
    │
    ↓
子布局（admin.html / user.html）
    │
    ├─ 继承自main.html
    ├─ 添加特定模块的侧边栏、面包屑
    │
    ↓
具体页面（user-list.html）
    │
    └─ 只需要关注业务内容
```

**示例：多层继承实现**

```html
<!-- 1. base.html 基础布局 -->
<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <title layout:title-pattern="$CONTENT_TITLE">基础布局</title>
  <link rel="stylesheet" href="https://cdn.example.com/css/reset.css">
</head>
<body>
  <div layout:fragment="body-content">
    <!-- 子布局会替换这里 -->
  </div>
</body>
</html>

<!-- 2. admin.html 管理后台布局（继承base.html） -->
<!DOCTYPE html>
<html layout:decorate="~{layout/base}">
<body>
  <div layout:fragment="body-content">
    <div class="admin-wrapper">
      <!-- 管理后台的侧边栏 -->
      <aside class="admin-sidebar">
        <nav>管理菜单</nav>
      </aside>
      
      <!-- 管理后台的主内容区 -->
      <main layout:fragment="admin-content">
        <!-- 具体页面会替换这里 -->
      </main>
    </div>
  </div>
</body>
</html>

<!-- 3. user-list.html 用户列表页（继承admin.html） -->
<!DOCTYPE html>
<html layout:decorate="~{layout/admin}">
<body>
  <div layout:fragment="admin-content">
    <h1>用户列表</h1>
    <table>...</table>
  </div>
</body>
</html>
```

---

## 4. 📦 layout:fragment内容片段管理


### 4.1 fragment片段的定义与使用

🎯 **片段就是"可替换的内容块"**

```
理解fragment的作用：

布局模板中定义占位符：
<div layout:fragment="content">
  默认内容
</div>

内容页面提供实际内容：
<div layout:fragment="content">
  实际要显示的内容
</div>

渲染结果：
内容页面的内容会替换布局中的默认内容
```

**🔧 fragment的完整用法**

```html
<!-- 布局模板：定义可替换区域 -->
<div layout:fragment="content">
  <!-- 这是默认内容，如果内容页面不提供，就显示这个 -->
  <p>正在加载内容...</p>
</div>

<div layout:fragment="sidebar">
  <!-- 可选的侧边栏区域 -->
  <div class="default-sidebar">默认侧边栏</div>
</div>

<!-- 内容页面：提供替换内容 -->
<div layout:fragment="content">
  <!-- 这个会替换布局中的content片段 -->
  <h1>欢迎页面</h1>
  <p>这是首页的内容</p>
</div>

<!-- 如果不提供sidebar片段，就使用布局的默认侧边栏 -->
```

### 4.2 多个片段的组合使用

**🔀 一个页面可以有多个内容片段**

```html
<!-- 布局模板：定义多个片段区域 -->
<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <!-- 额外的CSS片段 -->
  <th:block layout:fragment="extra-css">
    <!-- 内容页面可以添加特定的CSS -->
  </th:block>
</head>
<body>
  <!-- 面包屑导航片段 -->
  <nav layout:fragment="breadcrumb">
    <a href="/">首页</a>
  </nav>

  <!-- 主内容片段 -->
  <main layout:fragment="content">
    默认主内容
  </main>

  <!-- 侧边栏片段 -->
  <aside layout:fragment="sidebar">
    默认侧边栏
  </aside>

  <!-- 额外的JavaScript片段 -->
  <th:block layout:fragment="extra-js">
    <!-- 内容页面可以添加特定的JS -->
  </th:block>
</body>
</html>

<!-- 内容页面：填充多个片段 -->
<!DOCTYPE html>
<html layout:decorate="~{layout/main}">
<head>
  <!-- 添加页面特定的CSS -->
  <th:block layout:fragment="extra-css">
    <link rel="stylesheet" href="/css/user-list.css">
    <style>
      .user-table { width: 100%; }
    </style>
  </th:block>
</head>
<body>
  <!-- 自定义面包屑 -->
  <nav layout:fragment="breadcrumb">
    <a href="/">首页</a> > 
    <a href="/users">用户管理</a> > 
    <span>用户列表</span>
  </nav>

  <!-- 主内容 -->
  <main layout:fragment="content">
    <h1>用户列表</h1>
    <table class="user-table">
      <!-- 用户数据 -->
    </table>
  </main>

  <!-- 页面特定的JavaScript -->
  <th:block layout:fragment="extra-js">
    <script src="/js/user-list.js"></script>
    <script>
      $(document).ready(function() {
        // 页面初始化代码
      });
    </script>
  </th:block>
  
  <!-- 注意：没有定义sidebar片段，所以使用布局的默认侧边栏 -->
</body>
</html>
```

### 4.3 片段的替换策略

**🔄 三种片段处理方式**

```html
1. 完全替换（默认行为）
   布局定义：
   <div layout:fragment="content">
     旧内容
   </div>
   
   页面提供：
   <div layout:fragment="content">
     新内容
   </div>
   
   结果：旧内容完全被新内容替换

2. 内容追加（append）
   布局定义：
   <div layout:fragment="content">
     原有内容
   </div>
   
   页面提供：
   <div layout:fragment="content" layout:fragment-append>
     追加的内容
   </div>
   
   结果：
   <div>
     原有内容
     追加的内容
   </div>

3. 内容前置（prepend）
   布局定义：
   <div layout:fragment="content">
     原有内容
   </div>
   
   页面提供：
   <div layout:fragment="content" layout:fragment-prepend>
     前置的内容
   </div>
   
   结果：
   <div>
     前置的内容
     原有内容
   </div>
```

---

## 5. 📋 layout:title标题动态设置


### 5.1 标题的基础设置

🎯 **让每个页面有自己的标题**

```html
<!-- 布局模板中定义标题模式 -->
<head>
  <title layout:title-pattern="$CONTENT_TITLE - 我的网站">
    网站默认标题
  </title>
</head>

<!-- 内容页面中设置标题 -->
<head>
  <title>用户列表</title>
</head>

<!-- 最终渲染结果 -->
<head>
  <title>用户列表 - 我的网站</title>
</head>
```

**📝 标题模式说明**
```
$CONTENT_TITLE：内容页面的标题
$LAYOUT_TITLE：布局模板的标题

常用标题模式：
1. "$CONTENT_TITLE - $LAYOUT_TITLE"
   结果：用户列表 - 我的网站

2. "$LAYOUT_TITLE | $CONTENT_TITLE"
   结果：我的网站 | 用户列表

3. "[$CONTENT_TITLE] - $LAYOUT_TITLE"
   结果：[用户列表] - 我的网站

4. "$CONTENT_TITLE :: $LAYOUT_TITLE"
   结果：用户列表 :: 我的网站
```

### 5.2 条件标题设置

**🔀 根据不同情况设置标题**

```html
<!-- 内容页面：根据数据动态设置标题 -->
<!DOCTYPE html>
<html layout:decorate="~{layout/main}">
<head>
  <!-- 使用Thymeleaf表达式动态设置标题 -->
  <title th:text="${user != null ? user.name + '的详情' : '用户详情'}">
    用户详情
  </title>
</head>
<body>
  <div layout:fragment="content">
    <h1 th:text="${user.name}">用户名</h1>
    <p th:text="${user.email}">邮箱</p>
  </div>
</body>
</html>

<!-- 渲染结果示例 -->
<!-- 当user.name = "张三"时 -->
<title>张三的详情 - 我的网站</title>

<!-- 当user为null时 -->
<title>用户详情 - 我的网站</title>
```

**💡 多语言标题支持**
```html
<!-- 使用国际化消息设置标题 -->
<head>
  <title th:text="#{page.user.list.title}">User List</title>
</head>

<!-- messages.properties -->
page.user.list.title=用户列表

<!-- messages_en.properties -->
page.user.list.title=User List

<!-- messages_zh_CN.properties -->
page.user.list.title=用户列表
```

---

## 6. 🏛️ 统一页面结构设计


### 6.1 企业级布局设计实践

**🎨 完整的企业后台布局示例**

```html
<!-- layout/admin.html 企业后台标准布局 -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title layout:title-pattern="$CONTENT_TITLE - 企业管理系统">管理系统</title>
  
  <!-- 公共样式 -->
  <link th:href="@{/css/admin-framework.css}" rel="stylesheet">
  <link th:href="@{/css/icons.css}" rel="stylesheet">
  
  <!-- 页面特定样式插入点 -->
  <th:block layout:fragment="page-css"></th:block>
</head>

<body class="admin-layout">
  <!-- 顶部导航栏 -->
  <header class="top-navbar">
    <div class="navbar-left">
      <button id="sidebar-toggle">☰</button>
      <h1>企业管理系统</h1>
    </div>
    
    <div class="navbar-right">
      <!-- 使用Spring Security显示登录用户 -->
      <span sec:authentication="name">用户名</span>
      <a th:href="@{/logout}">退出</a>
    </div>
  </header>

  <!-- 侧边栏导航 -->
  <aside class="sidebar">
    <nav class="sidebar-menu">
      <a th:href="@{/admin/dashboard}" 
         th:classappend="${#strings.startsWith(#httpServletRequest.requestURI, '/admin/dashboard')} ? 'active'">
        📊 仪表盘
      </a>
      <a th:href="@{/admin/users}"
         th:classappend="${#strings.startsWith(#httpServletRequest.requestURI, '/admin/users')} ? 'active'">
        👥 用户管理
      </a>
      <a th:href="@{/admin/products}"
         th:classappend="${#strings.startsWith(#httpServletRequest.requestURI, '/admin/products')} ? 'active'">
        📦 商品管理
      </a>
      
      <!-- 自定义菜单片段 -->
      <div layout:fragment="custom-menu">
        <!-- 子页面可以添加特定菜单 -->
      </div>
    </nav>
  </aside>

  <!-- 主内容区域 -->
  <main class="main-content">
    <!-- 面包屑导航 -->
    <div class="breadcrumb">
      <a th:href="@{/admin}">首页</a>
      <span layout:fragment="breadcrumb-items">
        <!-- 子页面添加面包屑项 -->
      </span>
    </div>

    <!-- 页面内容区 -->
    <div class="content-wrapper">
      <!-- 消息通知区域 -->
      <div th:if="${message}" class="alert alert-success" th:text="${message}">
        操作成功消息
      </div>
      <div th:if="${error}" class="alert alert-danger" th:text="${error}">
        错误消息
      </div>

      <!-- 主要内容片段 -->
      <div layout:fragment="page-content">
        <p>页面内容加载中...</p>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="admin-footer">
    <p>&copy; 2024 企业管理系统 v1.0</p>
  </footer>

  <!-- 公共脚本 -->
  <script th:src="@{/js/jquery.min.js}"></script>
  <script th:src="@{/js/admin-common.js}"></script>
  
  <!-- 页面特定脚本插入点 -->
  <th:block layout:fragment="page-js"></th:block>
</body>
</html>
```

### 6.2 响应式布局设计

**📱 适配多种设备的布局**

```html
<!-- layout/responsive.html 响应式布局模板 -->
<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title layout:title-pattern="$CONTENT_TITLE">响应式网站</title>
  
  <style>
    /* 移动端优先设计 */
    .container {
      width: 100%;
      padding: 0 15px;
    }
    
    .sidebar {
      display: none; /* 移动端隐藏侧边栏 */
    }
    
    /* 平板设备 */
    @media (min-width: 768px) {
      .container {
        max-width: 750px;
        margin: 0 auto;
      }
      
      .sidebar {
        display: block;
        width: 25%;
      }
      
      .main-content {
        width: 75%;
      }
    }
    
    /* 桌面设备 */
    @media (min-width: 1200px) {
      .container {
        max-width: 1170px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 移动端顶部菜单 -->
    <nav class="mobile-nav">
      <button class="menu-toggle">☰</button>
      <div layout:fragment="mobile-menu">
        <!-- 移动端菜单项 -->
      </div>
    </nav>

    <!-- 内容布局 -->
    <div class="content-layout">
      <aside class="sidebar">
        <div layout:fragment="sidebar">侧边栏</div>
      </aside>
      
      <main class="main-content">
        <div layout:fragment="content">主内容</div>
      </main>
    </div>
  </div>
</body>
</html>
```

---

## 7. 🔗 布局继承机制深入理解


### 7.1 继承链的工作原理

🎯 **像家族继承一样的布局继承**

```
继承关系示意：

祖父布局（base.html）
    ├─ 定义：最基础的HTML5结构
    ├─ 包含：meta标签、基础CSS/JS
    │
    ↓ 继承
    
父布局（main.html）
    ├─ 继承：base.html的所有内容
    ├─ 添加：网站头部、导航、页脚
    ├─ 定义：content、sidebar等片段
    │
    ↓ 继承
    
子页面（user-list.html）
    ├─ 继承：main.html的完整结构
    └─ 填充：content片段的具体内容
```

**🔍 继承的传递过程**

```
Step 1: 子页面声明装饰器
<html layout:decorate="~{layout/main}">

Step 2: main.html 又装饰 base.html
<html layout:decorate="~{layout/base}">

Step 3: Thymeleaf解析继承链
base.html → main.html → user-list.html

Step 4: 从最底层开始渲染
1. 先渲染base.html的结构
2. 用main.html的内容替换base中的片段
3. 用user-list.html的内容替换main中的片段

最终输出：完整的三层合并结果
```

### 7.2 片段的覆盖与保留

**🔄 灵活控制内容的继承与覆盖**

```html
<!-- 场景1：完全覆盖父布局的片段 -->

父布局（main.html）：
<div layout:fragment="content">
  <p>这是父布局的默认内容</p>
  <div class="default-widget">默认组件</div>
</div>

子页面（page.html）：
<div layout:fragment="content">
  <h1>新页面</h1>
  <p>完全替换了父布局的内容</p>
</div>

渲染结果：
<div>
  <h1>新页面</h1>
  <p>完全替换了父布局的内容</p>
</div>

---

<!-- 场景2：保留并追加内容 -->

父布局的脚本：
<th:block layout:fragment="scripts">
  <script src="/js/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
</th:block>

子页面（保留父布局的脚本，再添加新脚本）：
<th:block layout:fragment="scripts" layout:fragment-append>
  <script src="/js/user-list.js"></script>
</th:block>

渲染结果：
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/user-list.js"></script> ← 追加的

---

<!-- 场景3：在父内容之前插入 -->

父布局的导航：
<nav layout:fragment="navbar">
  <a href="/home">首页</a>
  <a href="/about">关于</a>
</nav>

子页面（在父导航之前添加Logo）：
<nav layout:fragment="navbar" layout:fragment-prepend>
  <img src="/logo.png" alt="Logo">
</nav>

渲染结果：
<nav>
  <img src="/logo.png" alt="Logo"> ← 前置的
  <a href="/home">首页</a>
  <a href="/about">关于</a>
</nav>
```

### 7.3 实战：构建多级布局体系

**🏗️ 企业项目的完整布局架构**

```
项目布局文件结构：

templates/
├── layout/
│   ├── base.html           # 最基础布局
│   ├── main.html           # 主站布局（继承base）
│   ├── admin.html          # 管理后台布局（继承main）
│   └── mobile.html         # 移动端布局（继承base）
│
├── admin/
│   ├── dashboard.html      # 仪表盘（使用admin布局）
│   ├── users.html          # 用户管理（使用admin布局）
│   └── settings.html       # 系统设置（使用admin布局）
│
└── pages/
    ├── home.html           # 首页（使用main布局）
    ├── product-list.html   # 商品列表（使用main布局）
    └── about.html          # 关于页面（使用main布局）
```

**完整实现示例**

```html
<!-- 1. layout/base.html - 最底层布局 -->
<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title layout:title-pattern="$CONTENT_TITLE">网站</title>
  
  <!-- 全站通用资源 -->
  <link href="https://cdn.example.com/normalize.css" rel="stylesheet">
  
  <th:block layout:fragment="head-resources">
    <!-- 子布局可以添加额外的head资源 -->
  </th:block>
</head>
<body>
  <div layout:fragment="body-wrapper">
    <!-- 子布局定义完整的body结构 -->
  </div>
  
  <script src="https://cdn.example.com/jquery.min.js"></script>
  
  <th:block layout:fragment="body-scripts">
    <!-- 子布局可以添加额外的脚本 -->
  </th:block>
</body>
</html>

<!-- 2. layout/admin.html - 管理后台布局 -->
<!DOCTYPE html>
<html layout:decorate="~{layout/base}">
<head>
  <th:block layout:fragment="head-resources">
    <!-- 管理后台特定的样式 -->
    <link href="/css/admin.css" rel="stylesheet">
    <link href="/css/admin-icons.css" rel="stylesheet">
  </th:block>
</head>

<body>
  <div layout:fragment="body-wrapper">
    <!-- 后台管理的完整结构 -->
    <div class="admin-container">
      <!-- 顶部栏 -->
      <header class="admin-header">
        <h1>管理系统</h1>
        <div class="user-info" layout:fragment="user-info">
          当前用户
        </div>
      </header>

      <div class="admin-body">
        <!-- 侧边栏 -->
        <aside class="admin-sidebar">
          <nav layout:fragment="admin-menu">
            <a href="/admin">仪表盘</a>
          </nav>
        </aside>

        <!-- 主内容区 -->
        <main class="admin-main">
          <div layout:fragment="page-header">
            <!-- 页面标题区 -->
          </div>
          
          <div layout:fragment="page-content">
            <!-- 页面主要内容 -->
          </div>
        </main>
      </div>
    </div>
  </div>

  <th:block layout:fragment="body-scripts">
    <!-- 管理后台的脚本 -->
    <script src="/js/admin-common.js"></script>
  </th:block>
</body>
</html>

<!-- 3. admin/users.html - 用户管理页面 -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/admin}">
<head>
  <title>用户管理</title>
</head>

<body>
  <!-- 扩展管理菜单（追加模式） -->
  <nav layout:fragment="admin-menu" layout:fragment-append>
    <a href="/admin/users" class="active">用户管理</a>
  </nav>

  <!-- 页面标题 -->
  <div layout:fragment="page-header">
    <h2>用户管理</h2>
    <button>添加用户</button>
  </div>

  <!-- 页面内容 -->
  <div layout:fragment="page-content">
    <table class="user-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>用户名</th>
          <th>邮箱</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="user : ${users}">
          <td th:text="${user.id}">1</td>
          <td th:text="${user.username}">admin</td>
          <td th:text="${user.email}">admin@example.com</td>
          <td>
            <a th:href="@{/admin/users/{id}/edit(id=${user.id})}">编辑</a>
            <a th:href="@{/admin/users/{id}/delete(id=${user.id})}">删除</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</body>
</html>
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 Layout Dialect：Thymeleaf的布局扩展，实现页面装饰器模式
🔸 layout:decorate：在内容页面中声明使用哪个布局模板
🔸 layout:fragment：定义可替换的内容片段（占位符）
🔸 layout:title：动态设置页面标题，支持模式组合
🔸 装饰器模式：不改变内容本身，只是为它添加布局"装饰"
🔸 布局继承：支持多层继承，构建复杂的页面结构体系
🔸 片段策略：完全替换、追加（append）、前置（prepend）
```

### 8.2 关键理解要点


**🔹 Layout Dialect vs Include的本质区别**
```
include（传统方式）：
- 像拼图一样组装页面
- 主动引入其他片段
- 适合小组件复用
- 结构较分散

Layout Dialect（装饰器方式）：
- 像穿衣服一样给内容加框架
- 被动接受布局装饰
- 适合整体布局复用
- 结构更集中

选择建议：
- 整体页面结构 → 用Layout Dialect
- 小的可重用组件 → 用include/replace
- 可以组合使用发挥各自优势
```

**🔹 继承机制的工作流程**
```
理解要点：
1. 继承是从下往上声明的
   子页面 → 声明使用父布局
   父布局 → 声明使用祖父布局

2. 渲染是从上往下执行的
   祖父布局 → 提供基础结构
   父布局 → 填充部分片段
   子页面 → 填充最终内容

3. 片段是层层覆盖的
   每一层都可以完全替换或追加内容
   最终由最底层（子页面）决定最终显示
```

**🔹 企业级布局设计原则**
```
分层设计：
- base层：最通用的HTML结构和CDN资源
- main层：网站的主要框架（头部、导航、页脚）
- module层：特定模块的布局（后台、移动端等）
- page层：具体的业务页面

片段规划：
- 必须片段：content（主内容）
- 可选片段：sidebar、breadcrumb、extra-css、extra-js
- 保留片段：使用append/prepend扩展而不是替换

命名规范：
- 布局文件：layout/base.html, layout/admin.html
- 片段名称：语义化命名（content, sidebar, page-header）
- 路径引用：使用~{layout/xxx}相对路径
```

### 8.3 实际应用价值


**🎯 典型应用场景**
- **企业门户网站**：统一的页面头部、导航、页脚
- **管理后台系统**：标准化的后台管理布局
- **多端适配项目**：桌面端、移动端不同布局
- **多租户系统**：不同租户使用不同布局主题

**🔧 最佳实践建议**
- **布局文件组织**：按功能模块划分布局文件
- **片段粒度控制**：不要过度拆分，保持合理粒度
- **性能优化**：公共资源在父布局中加载一次
- **可维护性**：保持继承层级不超过3层

**📈 技术进阶方向**
- **动态布局选择**：根据用户权限或设备类型选择布局
- **主题系统集成**：结合布局实现多主题切换
- **国际化支持**：布局中集成多语言消息
- **前端框架整合**：与Vue/React等框架协同使用

**核心记忆口诀**：
- 装饰器模式穿衣裳，内容不变加外框
- fragment占位留空间，页面填充来替换
- 继承层层往上传,片段覆盖由下决
- 布局复用省时间，统一结构易维护