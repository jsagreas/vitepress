---
title: 1、模板片段定义与引用
---
## 📚 目录

1. [模板片段基础概念](#1-模板片段基础概念)
2. [片段定义与引用](#2-片段定义与引用)
3. [片段参数传递](#3-片段参数传递)
4. [片段表达式高级用法](#4-片段表达式高级用法)
5. [条件性片段加载](#5-条件性片段加载)
6. [核心要点总结](#6-核心要点总结)

---

## 1. 🎯 模板片段基础概念


### 1.1 什么是模板片段


**通俗理解**：
想象你在搭积木，每个积木块都是一个可以重复使用的零件。模板片段就像这些积木块，是页面中**可以复用的小模块**。

**实际场景**：
```
网站的每个页面都有相同的：
- 顶部导航栏
- 底部版权信息  
- 侧边栏菜单

如果每个页面都写一遍这些代码 → 太繁琐！
使用模板片段 → 写一次，到处使用！
```

**核心作用**：
- 🔸 **代码复用**：相同的HTML结构只写一次
- 🔸 **统一维护**：修改片段，所有使用的页面都更新
- 🔸 **模块化设计**：将页面拆分成独立的功能模块

### 1.2 为什么需要模板片段


**传统开发问题**：
```html
<!-- index.html -->
<nav>导航栏代码100行...</nav>
<main>首页内容</main>
<footer>底部代码50行...</footer>

<!-- about.html -->
<nav>导航栏代码100行...</nav>  <!-- 重复了！-->
<main>关于页面内容</main>
<footer>底部代码50行...</footer>  <!-- 又重复了！-->
```

**使用片段后**：
```html
<!-- fragments.html -->
<nav th:fragment="navbar">导航栏代码</nav>
<footer th:fragment="footer">底部代码</footer>

<!-- index.html -->
<div th:insert="~{fragments :: navbar}"></div>
<main>首页内容</main>
<div th:insert="~{fragments :: footer}"></div>
```

---

## 2. 📝 片段定义与引用


### 2.1 th:fragment - 定义片段


**基本语法**：
```html
<标签 th:fragment="片段名称">
    片段内容...
</标签>
```

**实战示例**：

创建 `fragments.html` 文件：
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<!-- 定义导航栏片段 -->
<nav th:fragment="navbar" class="navbar">
    <a href="/">首页</a>
    <a href="/about">关于</a>
    <a href="/contact">联系</a>
</nav>

<!-- 定义页脚片段 -->
<footer th:fragment="footer" class="footer">
    <p>© 2025 我的网站. 版权所有</p>
</footer>

</body>
</html>
```

> 💡 **理解要点**  
> `th:fragment="navbar"` 就像给这段代码起了个名字叫 "navbar"，其他页面就可以通过这个名字来使用它

### 2.2 th:insert - 插入片段


**作用说明**：  
将片段**整体插入**到指定标签内部，**保留**片段的外层标签。

**语法格式**：
```html
<div th:insert="~{模板名 :: 片段名}"></div>
```

**实例对比**：

使用 `th:insert`：
```html
<!-- index.html -->
<div th:insert="~{fragments :: navbar}"></div>
```

**渲染结果**：
```html
<div>
    <nav class="navbar">  ← 片段的nav标签被保留
        <a href="/">首页</a>
        <a href="/about">关于</a>
        <a href="/contact">联系</a>
    </nav>
</div>
```

### 2.3 th:replace - 替换片段


**作用说明**：  
用片段**完全替换**当前标签，**不保留**外层div。

**语法格式**：
```html
<div th:replace="~{模板名 :: 片段名}"></div>
```

**实例对比**：

使用 `th:replace`：
```html
<!-- index.html -->
<div th:replace="~{fragments :: navbar}"></div>
```

**渲染结果**：
```html
<nav class="navbar">  ← div被替换掉，直接是nav标签
    <a href="/">首页</a>
    <a href="/about">关于</a>
    <a href="/contact">联系</a>
</nav>
```

### 2.4 th:include - 包含片段内容（已废弃）


**重要提示**：⚠️ `th:include` 在 Thymeleaf 3.0+ 已被废弃，不推荐使用

**历史用法**：只包含片段的**内容**，不包含片段的外层标签

```html
<!-- 旧版本写法（不推荐）-->
<div th:include="~{fragments :: navbar}"></div>

<!-- 渲染结果 -->
<div>
    <a href="/">首页</a>  ← 没有nav标签，只有内容
    <a href="/about">关于</a>
    <a href="/contact">联系</a>
</div>
```

> 📌 **现代替代方案**  
> 使用 `th:insert` 或 `th:replace`，根据需求选择是否保留标签

### 2.5 三种引用方式对比


| 属性 | **保留宿主标签** | **保留片段标签** | **推荐使用** | **典型场景** |
|------|----------------|-----------------|------------|------------|
| `th:insert` | ✅ 保留 | ✅ 保留 | ⭐⭐⭐ | 需要额外包装的场景 |
| `th:replace` | ❌ 替换掉 | ✅ 保留 | ⭐⭐⭐⭐⭐ | 直接替换，最常用 |
| `th:include` | ✅ 保留 | ❌ 只要内容 | ❌ 已废弃 | 不推荐使用 |

**实战选择建议**：
- ✅ **90%的情况用 `th:replace`** - 简洁直接
- ✅ **需要额外包装时用 `th:insert`** - 比如要加个div容器
- ❌ **不要用 `th:include`** - 已过时

---

## 3. 🎁 片段参数传递


### 3.1 为什么需要参数传递


**实际需求场景**：
```
情况1：同一个按钮片段，不同页面显示不同文字
情况2：同一个卡片片段，展示不同的标题和内容
情况3：同一个表单片段，提交到不同的地址
```

**传统做法的问题**：
```html
<!-- 每个不同需求都要定义新片段，太繁琐！ -->
<button th:fragment="saveButton">保存</button>
<button th:fragment="submitButton">提交</button>
<button th:fragment="deleteButton">删除</button>
```

**使用参数后**：
```html
<!-- 一个片段搞定所有需求！ -->
<button th:fragment="btn(text)">
    <span th:text="${text}">按钮</span>
</button>
```

### 3.2 基础参数传递


**定义带参数的片段**：

`fragments.html`：
```html
<!-- 定义带参数的按钮片段 -->
<button th:fragment="btn(text, color)" 
        th:class="'btn btn-' + ${color}">
    <span th:text="${text}">按钮文字</span>
</button>
```

**使用片段并传参**：

`index.html`：
```html
<!-- 传递参数方式1: 按位置传参 -->
<div th:replace="~{fragments :: btn('保存', 'primary')}"></div>

<!-- 传递参数方式2: 按名称传参（更清晰）-->
<div th:replace="~{fragments :: btn(text='提交', color='success')}"></div>
```

**渲染结果**：
```html
<button class="btn btn-primary">
    <span>保存</span>
</button>

<button class="btn btn-success">
    <span>提交</span>
</button>
```

### 3.3 多参数传递实战


**复杂片段示例** - 用户卡片：

`fragments.html`：
```html
<div th:fragment="userCard(username, email, avatar, role)" 
     class="card">
    <img th:src="${avatar}" alt="头像">
    <h3 th:text="${username}">用户名</h3>
    <p th:text="${email}">邮箱</p>
    <span th:text="${role}" class="badge">角色</span>
</div>
```

**使用片段**：

```html
<!-- 显示管理员信息 -->
<div th:replace="~{fragments :: userCard(
    username='张三',
    email='zhangsan@example.com',
    avatar='/img/avatar1.jpg',
    role='管理员'
)}"></div>

<!-- 显示普通用户信息 -->
<div th:replace="~{fragments :: userCard(
    username='李四',
    email='lisi@example.com',
    avatar='/img/avatar2.jpg',
    role='用户'
)}"></div>
```

### 3.4 传递对象作为参数


**定义接收对象的片段**：

```html
<div th:fragment="productCard(product)" class="product">
    <img th:src="${product.image}" alt="商品图片">
    <h4 th:text="${product.name}">商品名称</h4>
    <p th:text="${product.price}">价格</p>
    <button>加入购物车</button>
</div>
```

**Java后端准备数据**：

```java
@Controller
public class ProductController {
    @GetMapping("/products")
    public String products(Model model) {
        Product product = new Product();
        product.setName("iPhone 15");
        product.setPrice(5999.00);
        product.setImage("/img/iphone15.jpg");
        
        model.addAttribute("product", product);
        return "products";
    }
}
```

**模板中使用**：

```html
<!-- 传递整个对象 -->
<div th:replace="~{fragments :: productCard(product=${product})}"></div>
```

> 💡 **参数传递技巧**  
> - 简单值直接写：`text='保存'`
> - 变量值用${}：`product=${product}`
> - 多个参数用逗号分隔

### 3.5 默认参数值设置


**定义带默认值的片段**：

```html
<div th:fragment="alert(message, type)" class="alert">
    <!-- 如果type没传，默认使用'info' -->
    <div th:class="'alert-' + ${type ?: 'info'}">
        <span th:text="${message}">提示信息</span>
    </div>
</div>
```

**使用示例**：

```html
<!-- 传了type参数 -->
<div th:replace="~{fragments :: alert('保存成功', 'success')}"></div>
<!-- 结果: <div class="alert-success">保存成功</div> -->

<!-- 没传type参数，使用默认值 -->
<div th:replace="~{fragments :: alert('这是提示', null)}"></div>
<!-- 结果: <div class="alert-info">这是提示</div> -->
```

---

## 4. 🔧 片段表达式高级用法


### 4.1 片段表达式语法详解


**完整语法格式**：
```
~{模板名 :: 片段选择器}
```

**语法组成部分**：
- `~{}` - 片段表达式的标志符号
- `模板名` - HTML文件名（不含.html后缀）
- `::` - 分隔符
- `片段选择器` - 可以是片段名或CSS选择器

### 4.2 三种选择片段的方式


**方式1：通过片段名称**（最常用）

```html
<!-- fragments.html -->
<nav th:fragment="navbar">导航栏</nav>

<!-- 使用 -->
<div th:replace="~{fragments :: navbar}"></div>
```

**方式2：通过DOM选择器**

```html
<!-- fragments.html -->
<nav id="main-nav">导航栏</nav>

<!-- 使用id选择器 -->
<div th:replace="~{fragments :: #main-nav}"></div>
```

```html
<!-- fragments.html -->
<nav class="navbar">导航栏</nav>

<!-- 使用class选择器 -->
<div th:replace="~{fragments :: .navbar}"></div>
```

**方式3：选择整个模板**

```html
<!-- 使用整个fragments.html的body内容 -->
<div th:replace="~{fragments}"></div>
```

### 4.3 简化写法


**完整写法 vs 简化写法**：

```html
<!-- 完整写法（推荐，更清晰）-->
<div th:replace="~{fragments :: navbar}"></div>

<!-- 简化写法1：省略~{} -->
<div th:replace="fragments :: navbar"></div>

<!-- 简化写法2：同模板内引用，省略模板名 -->
<div th:replace=":: navbar"></div>
```

> ⚠️ **注意事项**  
> 虽然可以简化，但建议使用完整写法 `~{}`，代码更清晰，避免混淆

### 4.4 动态片段选择


**根据条件选择不同片段**：

`fragments.html`：
```html
<div th:fragment="adminNav">管理员导航</div>
<div th:fragment="userNav">用户导航</div>
```

**动态选择**：
```html
<!-- 根据用户角色动态选择片段 -->
<div th:replace="~{fragments :: ${user.isAdmin ? 'adminNav' : 'userNav'}}"></div>
```

**实战示例**：

Java Controller：
```java
model.addAttribute("userRole", "admin");  // 或 "user"
```

模板使用：
```html
<div th:replace="~{fragments :: ${userRole == 'admin' ? 'adminNav' : 'userNav'}}"></div>
```

---

## 5. 🎨 条件性片段加载


### 5.1 基于条件显示片段


**场景需求**：
```
- 登录用户显示个人中心
- 未登录用户显示登录按钮
- VIP用户显示专属功能
```

**实现方式1：使用 th:if**

`fragments.html`：
```html
<!-- 登录后的导航 -->
<nav th:fragment="userNav">
    <a href="/profile">个人中心</a>
    <a href="/logout">退出</a>
</nav>

<!-- 未登录的导航 -->
<nav th:fragment="guestNav">
    <a href="/login">登录</a>
    <a href="/register">注册</a>
</nav>
```

使用：
```html
<!-- 条件性加载片段 -->
<div th:if="${isLogin}" th:replace="~{fragments :: userNav}"></div>
<div th:unless="${isLogin}" th:replace="~{fragments :: guestNav}"></div>
```

**实现方式2：片段内部条件**

```html
<nav th:fragment="navbar">
    <!-- VIP专属功能，条件显示 -->
    <a th:if="${user.isVip}" href="/vip">VIP专区</a>
    
    <!-- 普通功能，始终显示 -->
    <a href="/">首页</a>
    <a href="/about">关于</a>
</nav>
```

### 5.2 基于权限的片段加载


**定义权限片段**：

```html
<!-- 管理功能片段 -->
<div th:fragment="adminPanel">
    <h3>管理面板</h3>
    <button>用户管理</button>
    <button>系统设置</button>
</div>

<!-- 编辑功能片段 -->
<div th:fragment="editorPanel">
    <h3>编辑面板</h3>
    <button>发布文章</button>
    <button>草稿箱</button>
</div>
```

**根据权限加载**：

```html
<!-- 使用 th:switch 多条件判断 -->
<div th:switch="${user.role}">
    <div th:case="'admin'" th:replace="~{fragments :: adminPanel}"></div>
    <div th:case="'editor'" th:replace="~{fragments :: editorPanel}"></div>
    <div th:case="*">
        <p>无权限访问</p>
    </div>
</div>
```

### 5.3 列表循环中使用片段


**场景**：渲染商品列表，每个商品都用同一个片段

**片段定义**：
```html
<div th:fragment="productItem(product)" class="product-card">
    <img th:src="${product.image}" />
    <h4 th:text="${product.name}">商品名</h4>
    <p th:text="${product.price}">价格</p>
    <button>购买</button>
</div>
```

**循环使用片段**：
```html
<!-- 商品列表 -->
<div th:each="product : ${productList}">
    <div th:replace="~{fragments :: productItem(product=${product})}"></div>
</div>
```

**渲染结果**：
```html
<div class="product-card">
    <img src="/img/product1.jpg" />
    <h4>商品A</h4>
    <p>99.00</p>
    <button>购买</button>
</div>
<div class="product-card">
    <img src="/img/product2.jpg" />
    <h4>商品B</h4>
    <p>199.00</p>
    <button>购买</button>
</div>
```

### 5.4 空值安全的片段加载


**问题场景**：
```
如果数据为空，直接使用片段可能报错
需要先判断数据是否存在
```

**安全加载方式**：

```html
<!-- 先判断数据是否存在 -->
<div th:if="${user != null}">
    <div th:replace="~{fragments :: userCard(user=${user})}"></div>
</div>

<!-- 数据为空时显示提示 -->
<div th:unless="${user != null}">
    <p>暂无用户数据</p>
</div>
```

**Elvis运算符简化写法**：

```html
<!-- 使用 ?: 提供默认值 -->
<div th:replace="~{fragments :: alert(
    message=${successMsg ?: '操作成功'},
    type='success'
)}"></div>
```

---

## 6. 📋 核心要点总结


### 6.1 必须掌握的核心概念


**片段定义与使用**：
```
🔸 th:fragment - 定义可复用的代码片段
🔸 th:replace - 最常用，直接替换宿主标签
🔸 th:insert - 保留宿主标签，插入片段
🔸 ~{模板名 :: 片段名} - 标准引用语法
```

**参数传递**：
```
🔸 定义参数：th:fragment="btn(text, color)"
🔸 位置传参：btn('保存', 'primary')
🔸 命名传参：btn(text='保存', color='primary')
🔸 对象传参：userCard(user=${user})
```

### 6.2 实用技巧总结


**选择合适的引用方式**：
```
✅ 推荐 th:replace - 90%的场景都适用
✅ 特殊需求用 th:insert - 需要额外包装时
❌ 避免 th:include - 已废弃，不要用
```

**片段选择方式**：
```
方式1: ~{fragments :: navbar}          ← 通过片段名（最常用）
方式2: ~{fragments :: #navbar}         ← 通过ID选择器
方式3: ~{fragments :: .navbar}         ← 通过Class选择器
方式4: ~{fragments :: ${dynamicName}}  ← 动态选择
```

**条件加载最佳实践**：
```
1. 使用 th:if/unless 控制片段加载
2. 结合 th:switch 实现多条件判断
3. 循环中使用片段渲染列表
4. 做好空值检查，避免报错
```

### 6.3 常见应用场景


| 场景 | **使用方式** | **示例代码** |
|------|------------|------------|
| **公共导航栏** | 定义一次，全站复用 | `<div th:replace="~{common :: navbar}"></div>` |
| **页脚版权** | 统一维护，一改全改 | `<div th:replace="~{common :: footer}"></div>` |
| **用户信息卡** | 传递参数，动态展示 | `th:replace="~{user :: card(user=${user})}"` |
| **权限控制** | 条件加载，按权限显示 | `th:if="${isAdmin}" th:replace="~{admin :: panel}"` |
| **列表渲染** | 循环使用片段 | `th:each` + `th:replace` 组合使用 |

### 6.4 记忆口诀


```
片段定义用fragment，复用代码不重写
replace最常用，直接替换不保留
insert需包装，保留标签再插入
参数传递很灵活，对象变量都能传
条件加载配th:if，权限控制更安全
```

### 6.5 实战开发建议


**文件组织建议**：
```
templates/
  ├── fragments/
  │   ├── common.html      # 公共片段（导航、页脚）
  │   ├── user.html        # 用户相关片段
  │   └── admin.html       # 管理相关片段
  ├── layout/
  │   └── base.html        # 基础布局模板
  └── pages/
      ├── index.html       # 具体页面
      └── about.html
```

**命名规范建议**：
```
✅ 片段名使用驼峰命名：userCard, navbarTop
✅ 参数名要语义明确：username, productId
✅ 文件名见名知意：common.html, user-fragments.html
```

**性能优化提示**：
```
🔸 合理拆分片段，避免过度碎片化
🔸 常用片段放在同一个文件，减少模板加载
🔸 使用条件加载，避免不必要的渲染
🔸 复杂片段考虑缓存策略
```