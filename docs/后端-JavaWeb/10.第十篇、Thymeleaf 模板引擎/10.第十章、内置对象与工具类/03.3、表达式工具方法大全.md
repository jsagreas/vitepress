---
title: 3、表达式工具方法大全
---
## 📚 目录

1. [表达式工具方法概述](#1-表达式工具方法概述)
2. [字符串操作方法](#2-字符串操作方法)
3. [数字计算方法](#3-数字计算方法)
4. [日期处理方法](#4-日期处理方法)
5. [集合操作方法](#5-集合操作方法)
6. [类型转换方法](#6-类型转换方法)
7. [条件判断方法](#7-条件判断方法)
8. [格式化方法](#8-格式化方法)
9. [综合实战案例](#9-综合实战案例)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🎯 表达式工具方法概述


### 1.1 什么是表达式工具方法


**通俗理解**：表达式工具方法就是Thymeleaf模板里的"瑞士军刀"，让你在HTML页面中直接处理数据。

```
生活类比：
就像微信聊天时的表情包、文字加粗、艾特好友等快捷功能
你不需要切换到其他APP，就能直接在聊天界面完成各种操作

Thymeleaf表达式工具：
你不需要在Java后端处理好所有数据
直接在HTML模板里就能格式化、计算、转换数据
```

**核心价值**：
- 🔸 **简化开发**：减少后端代码，前端直接处理
- 🔸 **提高效率**：常用操作一行代码搞定
- 🔸 **代码清晰**：数据处理逻辑更直观

### 1.2 工具方法的分类体系


```
表达式工具方法家族树：
│
├── 字符串处理 (#strings)
│   ├── 大小写转换
│   ├── 截取拼接
│   └── 查找替换
│
├── 数字计算 (#numbers)
│   ├── 格式化显示
│   ├── 数学运算
│   └── 序列生成
│
├── 日期时间 (#dates, #calendars)
│   ├── 格式化显示
│   ├── 日期运算
│   └── 时区处理
│
├── 集合操作 (#lists, #sets, #maps)
│   ├── 遍历过滤
│   ├── 排序去重
│   └── 聚合统计
│
├── 条件判断 (#bools)
│   ├── 真假判断
│   ├── 空值检查
│   └── 逻辑运算
│
└── 格式转换 (#objects, #arrays)
    ├── 类型转换
    ├── 默认值处理
    └── 数据校验
```

### 1.3 使用方式说明


**基本语法**：
```html
<!-- 使用#号开头的内置对象 -->
<p th:text="${#strings.toUpperCase(name)}">转大写</p>

<!-- 可以链式调用 -->
<p th:text="${#strings.substring(text, 0, 10)}">截取前10个字符</p>

<!-- 结合其他表达式使用 -->
<p th:text="${#numbers.formatDecimal(price, 1, 2)}">格式化价格</p>
```

::: tip 💡 学习建议
- 先掌握常用的字符串、数字、日期方法
- 根据实际项目需求查阅其他方法
- 多写多练，形成肌肉记忆
:::

---

## 2. 🔤 字符串操作方法


### 2.1 大小写转换


**实际应用场景**：用户名显示、标题格式化、关键词高亮等

| 方法 | 作用 | 示例 | 结果 |
|------|------|------|------|
| `toUpperCase()` | 转大写 | `${#strings.toUpperCase('hello')}` | `HELLO` |
| `toLowerCase()` | 转小写 | `${#strings.toLowerCase('WORLD')}` | `world` |
| `capitalize()` | 首字母大写 | `${#strings.capitalize('john')}` | `John` |
| `capitalizeWords()` | 每个单词首字母大写 | `${#strings.capitalizeWords('hello world')}` | `Hello World` |

**实战示例**：
```html
<!-- 用户名显示：首字母大写 -->
<h3>欢迎, <span th:text="${#strings.capitalize(username)}">Guest</span>!</h3>

<!-- 标题全大写显示 -->
<h1 th:text="${#strings.toUpperCase(pageTitle)}">PAGE TITLE</h1>

<!-- 文章标题：每个单词首字母大写 -->
<div class="article-title" th:text="${#strings.capitalizeWords(article.title)}">
    Article Title Here
</div>
```

### 2.2 字符串截取与拼接


**🔍 核心方法解析**

```
substring(str, start, end)  - 截取字符串
├── str: 原字符串
├── start: 开始位置（从0开始）
└── end: 结束位置（不包含）

示例：substring('hello world', 0, 5) → 'hello'
```

| 方法 | 说明 | 实际应用 |
|------|------|----------|
| `substring(str, start, end)` | 截取指定范围 | 文章摘要、搜索结果预览 |
| `substringBefore(str, substr)` | 截取指定字符前的内容 | 提取@前的用户名 |
| `substringAfter(str, substr)` | 截取指定字符后的内容 | 提取文件扩展名 |
| `concat(str1, str2, ...)` | 拼接多个字符串 | 组合显示姓名 |
| `prepend(str, prefix)` | 在前面添加内容 | 添加货币符号 |
| `append(str, suffix)` | 在后面添加内容 | 添加单位 |

**实战案例**：

```html
<!-- 文章摘要：显示前100个字符 -->
<div class="summary">
    <p th:text="${#strings.substring(article.content, 0, 100) + '...'}">
        文章摘要内容...
    </p>
</div>

<!-- 邮箱显示：提取用户名部分 -->
<span th:text="${#strings.substringBefore(email, '@')}">username</span>

<!-- 文件类型显示 -->
<span class="file-type" 
      th:text="${#strings.substringAfter(filename, '.')}">
    pdf
</span>

<!-- 价格显示：添加货币符号 -->
<span th:text="${#strings.prepend(price, '¥')}">¥99.00</span>

<!-- 单位显示 -->
<span th:text="${#strings.append(weight, 'kg')}">50kg</span>
```

### 2.3 字符串查找与替换


**🎯 常用场景**：关键词高亮、敏感词过滤、格式化显示

| 方法 | 功能 | 返回值 | 示例 |
|------|------|--------|------|
| `contains(str, fragment)` | 是否包含子串 | `true/false` | 检查是否包含关键词 |
| `containsIgnoreCase()` | 忽略大小写检查 | `true/false` | 模糊搜索匹配 |
| `startsWith(str, prefix)` | 是否以某字符开头 | `true/false` | 检查文件类型 |
| `endsWith(str, suffix)` | 是否以某字符结尾 | `true/false` | 检查文件扩展名 |
| `indexOf(str, substr)` | 查找首次出现位置 | `数字位置` | 定位关键字 |
| `replace(str, old, new)` | 替换字符串 | `新字符串` | 敏感词过滤 |

**实用示例**：

```html
<!-- 关键词搜索结果高亮 -->
<div th:if="${#strings.contains(article.title, searchKeyword)}">
    <h3 class="highlight" th:text="${article.title}">文章标题</h3>
</div>

<!-- VIP用户标识 -->
<span th:if="${#strings.startsWith(username, 'VIP_')}" 
      class="vip-badge">VIP</span>

<!-- 图片文件判断 -->
<div th:if="${#strings.endsWith(filename, '.jpg') or 
              #strings.endsWith(filename, '.png')}">
    <img th:src="${filepath}" alt="图片"/>
</div>

<!-- 敏感词替换 -->
<p th:text="${#strings.replace(comment, '敏感词', '***')}">
    用户评论内容
</p>
```

### 2.4 字符串长度与判空


**🔸 基础方法**

```
isEmpty(str)     - 判断是否为空字符串 ""
isEmptyOrWhitespace(str) - 判断是否为空或只有空格
length(str)      - 获取字符串长度
trim(str)        - 去除首尾空格
```

**实际应用**：

```html
<!-- 评论内容验证 -->
<div th:if="${!#strings.isEmpty(comment)}">
    <p th:text="${comment}">用户评论</p>
</div>

<!-- 字数统计提示 -->
<span class="char-count">
    还可以输入 
    <span th:text="${200 - #strings.length(content)}">200</span> 
    个字
</span>

<!-- 用户输入处理：去除空格 -->
<input type="text" th:value="${#strings.trim(userInput)}" />

<!-- 空内容友好提示 -->
<div th:if="${#strings.isEmptyOrWhitespace(description)}">
    <p class="empty-tip">暂无描述信息</p>
</div>
```

::: warning ⚠️ 常见误区
**错误理解**：`isEmpty()` 能检查 `null` 值
**正确做法**：需要先判断对象是否为 `null`

```html
<!-- ❌ 错误写法 -->
<div th:if="${#strings.isEmpty(title)}">...</div>

<!-- ✅ 正确写法 -->
<div th:if="${title == null or #strings.isEmpty(title)}">...</div>
```
:::

---

## 3. 🔢 数字计算方法


### 3.1 数字格式化显示


**为什么需要格式化**？
- 让数字更易读：`1000000` → `1,000,000`
- 统一小数位数：`3.1` → `3.10`
- 添加货币符号：`100` → `¥100.00`

**核心方法**：

| 方法 | 参数说明 | 效果 | 应用场景 |
|------|----------|------|----------|
| `formatDecimal(num, int, dec)` | `整数位,小数位` | `1,234.56` | 🔸 价格、金额 |
| `formatInteger(num, int)` | `最小整数位` | `0001` | 🔸 订单号、编号 |
| `formatPercent(num, int, dec)` | `整数位,小数位` | `45.67%` | 🔸 百分比、进度 |
| `formatCurrency(num)` | 自动货币格式 | `¥1,234.56` | 🔸 金额显示 |

**实战案例**：

```html
<!-- 商品价格：保留2位小数，千分位分隔 -->
<span class="price">
    ¥<span th:text="${#numbers.formatDecimal(product.price, 1, 2)}">99.00</span>
</span>

<!-- 订单编号：不足8位前面补0 -->
<div class="order-id">
    订单号: <span th:text="${#numbers.formatInteger(orderId, 8)}">00001234</span>
</div>

<!-- 完成进度：百分比显示 -->
<div class="progress-bar">
    <span th:text="${#numbers.formatPercent(progress, 1, 1)}">45.5%</span>
</div>

<!-- 销售统计 -->
<table class="sales-table">
    <tr>
        <td>今日销售额：</td>
        <td th:text="${#numbers.formatCurrency(todaySales)}">¥12,345.67</td>
    </tr>
</table>
```

### 3.2 数字序列生成


**应用场景**：分页、评分星级、进度展示

```
sequence(from, to)        - 生成连续数字序列
sequence(from, to, step)  - 指定步长生成序列

示例：
sequence(1, 5)     → [1, 2, 3, 4, 5]
sequence(0, 10, 2) → [0, 2, 4, 6, 8, 10]
```

**实际应用**：

```html
<!-- 分页导航 -->
<div class="pagination">
    <a th:each="page : ${#numbers.sequence(1, totalPages)}"
       th:href="@{/list(page=${page})}"
       th:text="${page}"
       th:class="${page == currentPage ? 'active' : ''}">
        1
    </a>
</div>

<!-- 星级评分显示 -->
<div class="rating">
    <span th:each="star : ${#numbers.sequence(1, 5)}"
          th:class="${star <= rating ? 'star-fill' : 'star-empty'}">
        ★
    </span>
</div>

<!-- 进度步骤 -->
<div class="steps">
    <div th:each="step : ${#numbers.sequence(1, 4)}"
         th:class="${step <= currentStep ? 'step-done' : 'step-todo'}">
        步骤 <span th:text="${step}">1</span>
    </div>
</div>
```

### 3.3 数组下标操作


```
arraylen(array)           - 获取数组长度
arrayGet(array, index)    - 获取指定位置元素
arrayContains(array, val) - 判断是否包含元素
```

**使用示例**：

```html
<!-- 数组长度显示 -->
<p>共有 <span th:text="${#arrays.length(products)}">0</span> 件商品</p>

<!-- 获取第一个元素 -->
<div th:if="${#arrays.length(imageList) > 0}">
    <img th:src="${imageList[0]}" alt="首图" />
</div>

<!-- 判断元素是否存在 -->
<span th:if="${#arrays.contains(tags, 'hot')}" class="hot-tag">HOT</span>
```

---

## 4. 📅 日期处理方法


### 4.1 日期格式化显示


**为什么日期格式化重要**？
```
后端传来的日期：2025-09-23T14:30:00
用户想看到的日期：2025年9月23日 14:30

就像把 "20250923143000" 翻译成人类能读懂的 "今天下午两点半"
```

**核心方法对比**：

| 方法 | 适用类型 | 格式示例 | 应用场景 |
|------|----------|----------|----------|
| `#dates.format(date, pattern)` | `java.util.Date` | `yyyy-MM-dd HH:mm` | 🔸 传统Date对象 |
| `#temporals.format(temporal, pattern)` | `LocalDateTime` | `yyyy年MM月dd日` | 🔸 Java 8+ 时间类 |
| `#calendars.format(calendar, pattern)` | `Calendar` | `MM/dd/yyyy` | 🔸 日历对象 |

**常用日期格式模式**：

```
📅 日期部分：
yyyy - 四位年份 (2025)
yy   - 两位年份 (25)
MM   - 月份数字 (09)
dd   - 日期数字 (23)
E    - 星期几 (周一)

⏰ 时间部分：
HH   - 24小时制 (14)
hh   - 12小时制 (02)
mm   - 分钟 (30)
ss   - 秒 (45)
a    - 上午/下午 (PM)
```

**实战案例**：

```html
<!-- 文章发布时间：友好格式 -->
<div class="publish-time">
    发布于: <span th:text="${#dates.format(article.publishTime, 'yyyy年MM月dd日 HH:mm')}">
        2025年9月23日 14:30
    </span>
</div>

<!-- 订单时间：标准格式 -->
<tr>
    <td>下单时间:</td>
    <td th:text="${#dates.format(order.createTime, 'yyyy-MM-dd HH:mm:ss')}">
        2025-09-23 14:30:45
    </td>
</tr>

<!-- 活动倒计时：星期显示 -->
<div class="event-date">
    活动时间: 
    <span th:text="${#dates.format(eventDate, 'MM月dd日 E')}">
        9月23日 周一
    </span>
</div>

<!-- 简洁日期显示 -->
<span class="simple-date" th:text="${#dates.format(date, 'MM/dd')}">
    09/23
</span>
```

### 4.2 日期属性提取


**快速获取日期的各个部分**

```
year(date)    - 获取年份   → 2025
month(date)   - 获取月份   → 9 (注意:从1开始)
day(date)     - 获取日期   → 23
hour(date)    - 获取小时   → 14
minute(date)  - 获取分钟   → 30
second(date)  - 获取秒     → 45
```

**实际应用**：

```html
<!-- 日历视图：按年月分组 -->
<div class="calendar-header">
    <h3>
        <span th:text="${#dates.year(currentDate)}">2025</span>年
        <span th:text="${#dates.month(currentDate)}">9</span>月
    </h3>
</div>

<!-- 生日祝福判断 -->
<div th:if="${#dates.day(user.birthday) == #dates.day(today) and 
              #dates.month(user.birthday) == #dates.month(today)}">
    🎂 今天是您的生日，祝您生日快乐！
</div>

<!-- 营业时间判断 -->
<div class="business-status">
    <span th:if="${#dates.hour(now) >= 9 and #dates.hour(now) < 18}"
          class="open">营业中</span>
    <span th:unless="${#dates.hour(now) >= 9 and #dates.hour(now) < 18}"
          class="closed">已打烊</span>
</div>
```

### 4.3 日期创建与对比


**创建日期对象**：
```
createNow()              - 当前时间
createToday()            - 今天0点
create(year,month,day)   - 指定日期
```

**日期对比**：
```html
<!-- 是否是新文章：3天内发布 -->
<span th:if="${article.publishTime.after(#dates.createNow().minusDays(3))}"
      class="new-badge">NEW</span>

<!-- 活动状态判断 -->
<div th:if="${event.startTime.before(#dates.createNow()) and 
              event.endTime.after(#dates.createNow())}">
    <span class="status-active">活动进行中</span>
</div>

<!-- 过期提醒 -->
<div th:if="${coupon.expireDate.before(#dates.createToday())}">
    <p class="expired-tip">优惠券已过期</p>
</div>
```

::: tip 💡 时间处理技巧
**Java 8+ 推荐用法**：
- 使用 `LocalDateTime` 替代 `Date`
- 使用 `#temporals` 工具方法
- 更清晰的API和更好的性能

```html
<!-- 推荐写法 -->
<span th:text="${#temporals.format(dateTime, 'yyyy-MM-dd')}"></span>

<!-- 传统写法 -->
<span th:text="${#dates.format(date, 'yyyy-MM-dd')}"></span>
```
:::

---

## 5. 📦 集合操作方法


### 5.1 集合基础操作


**🏠 生活类比**：
```
List就像购物车 - 有顺序的商品列表，可以重复
Set就像好友列表 - 不重复的用户集合
Map就像通讯录 - 姓名和电话号码的对应关系
```

**基础判断方法**：

| 方法 | 作用 | 返回值 | 实际应用 |
|------|------|--------|----------|
| `isEmpty(collection)` | 判断是否为空 | `true/false` | 列表无数据提示 |
| `size(collection)` | 获取元素数量 | `数字` | 商品数量统计 |
| `contains(collection, element)` | 是否包含元素 | `true/false` | 权限检查 |
| `containsAll(coll, elements)` | 是否包含所有元素 | `true/false` | 批量权限验证 |

**实战示例**：

```html
<!-- 购物车为空提示 -->
<div th:if="${#lists.isEmpty(cartItems)}">
    <p class="empty-cart">购物车是空的，去逛逛吧~</p>
</div>

<!-- 商品数量徽章 -->
<span class="cart-badge" th:text="${#lists.size(cartItems)}">0</span>

<!-- VIP权限检查 -->
<div th:if="${#lists.contains(user.roles, 'VIP')}">
    <button class="vip-feature">VIP专享功能</button>
</div>

<!-- 多权限验证 -->
<div th:if="${#sets.containsAll(user.permissions, {'READ', 'WRITE'})}">
    <button>编辑内容</button>
</div>
```

### 5.2 集合排序操作


**排序场景**：商品价格排序、日期排序、评分排序

```
sort(collection)              - 自然排序（升序）
sort(collection, comparator)  - 自定义排序
toList(set)                   - Set转List后排序
```

**实用案例**：

```html
<!-- 商品价格从低到高 -->
<div th:each="product : ${#lists.sort(products, 'price')}">
    <span th:text="${product.name}">商品名</span>
    <span th:text="${product.price}">价格</span>
</div>

<!-- 最新评论在前 -->
<div th:each="comment : ${#lists.sort(comments, 'createTime')}">
    <p th:text="${comment.content}">评论内容</p>
    <small th:text="${#dates.format(comment.createTime, 'MM-dd HH:mm')}">
        时间
    </small>
</div>

<!-- 热门文章排序：按阅读量倒序 -->
<div th:each="article : ${#lists.sort(articles, 'viewCount').reverse()}">
    <h4 th:text="${article.title}">文章标题</h4>
    <span>阅读 <span th:text="${article.viewCount}">0</span></span>
</div>
```

### 5.3 Map集合操作


**Map操作**就像查字典：
- 知道页码(key)，就能找到内容(value)
- 可以列出所有页码(keys)
- 可以翻阅所有内容(values)

**核心方法**：

```
size(map)           - 获取键值对数量
isEmpty(map)        - 判断是否为空
containsKey(map, key)    - 是否包含指定键
containsValue(map, value) - 是否包含指定值
```

**实战应用**：

```html
<!-- 用户配置显示 -->
<div class="user-settings">
    <p>配置项数量: <span th:text="${#maps.size(userConfig)}">0</span></p>
    
    <!-- 检查是否有主题设置 -->
    <div th:if="${#maps.containsKey(userConfig, 'theme')}">
        <span>当前主题: </span>
        <span th:text="${userConfig['theme']}">默认</span>
    </div>
</div>

<!-- 商品属性展示 -->
<table class="product-attrs">
    <tr th:each="entry : ${productAttrs}">
        <td th:text="${entry.key}">属性名</td>
        <td th:text="${entry.value}">属性值</td>
    </tr>
</table>

<!-- 统计信息 -->
<div th:if="${!#maps.isEmpty(statistics)}">
    <h4>数据统计</h4>
    <ul>
        <li th:each="stat : ${statistics}">
            <span th:text="${stat.key}">指标</span>: 
            <span th:text="${stat.value}">数值</span>
        </li>
    </ul>
</div>
```

### 5.4 集合聚合操作


**聚合计算**：求和、平均值、最大最小值

```
🎯 常用聚合函数：

listSum(list, property)    - 对列表某属性求和
listAvg(list, property)    - 求平均值
listMax(list, property)    - 求最大值
listMin(list, property)    - 求最小值
```

**实际案例**：

```html
<!-- 购物车总价计算 -->
<div class="cart-total">
    <span>商品总计: </span>
    <span class="total-price">
        ¥<span th:text="${#aggregates.sum(cartItems.![price * quantity])}">
            0.00
        </span>
    </span>
</div>

<!-- 平均评分显示 -->
<div class="rating-avg">
    平均评分: 
    <span th:text="${#numbers.formatDecimal(
                    #aggregates.avg(reviews.![score]), 1, 1)}">
        4.5
    </span>
    <span class="star">★</span>
</div>

<!-- 价格区间 -->
<div class="price-range">
    <span>¥<span th:text="${#aggregates.min(products.![price])}">99</span></span>
    -
    <span>¥<span th:text="${#aggregates.max(products.![price])}">999</span></span>
</div>
```

---

## 6. 🔄 类型转换方法


### 6.1 基本类型转换


**为什么需要类型转换**？
```
场景1: URL参数是字符串 "100"，需要转成数字计算
场景2: 用户输入 "true"，需要转成布尔值判断
场景3: 日期字符串 "2025-09-23"，需要转成Date对象
```

**核心转换方法**：

| 方法 | 转换方向 | 示例 | 应用场景 |
|------|----------|------|----------|
| `toString(obj)` | 任意→字符串 | `toString(100)` → `"100"` | 数字显示 |
| `toInteger(str)` | 字符串→整数 | `toInteger("100")` → `100` | 参数解析 |
| `toDouble(str)` | 字符串→小数 | `toDouble("3.14")` → `3.14` | 价格计算 |
| `toBoolean(str)` | 字符串→布尔 | `toBoolean("true")` → `true` | 状态判断 |

**实战应用**：

```html
<!-- URL参数计算 -->
<div th:with="pageNum=${#conversions.toInteger(param.page)}">
    当前第 <span th:text="${pageNum}">1</span> 页
    共 <span th:text="${pageNum * 10}">10</span> 条数据
</div>

<!-- 折扣计算 -->
<div th:with="discount=${#conversions.toDouble(product.discount)}">
    <span class="original-price" th:text="${product.price}">100</span>
    <span class="sale-price" 
          th:text="${product.price * discount}">
        80
    </span>
</div>

<!-- 开关状态 -->
<div th:with="enabled=${#conversions.toBoolean(config.enable)}">
    <span th:if="${enabled}" class="status-on">已启用</span>
    <span th:unless="${enabled}" class="status-off">已禁用</span>
</div>
```

### 6.2 默认值处理


**核心思想**：当数据为空时，提供默认值，避免页面报错

```
defaultString(obj, default)     - 对象为null时返回默认字符串
elvis操作符: ${obj ?: 'default'} - 更简洁的写法
```

**实用示例**：

```html
<!-- 用户昵称：没有则显示默认值 -->
<span th:text="${user.nickname ?: '游客'}">游客</span>

<!-- 商品描述：空则提示 -->
<p th:text="${product.description ?: '暂无描述'}">
    暂无描述
</p>

<!-- 数量默认值 -->
<input type="number" 
       th:value="${quantity ?: 1}" 
       min="1" />

<!-- 多层默认值 -->
<div th:text="${user.realName ?: user.nickname ?: '匿名用户'}">
    匿名用户
</div>
```

::: tip 💡 Elvis操作符技巧
**简化写法对比**：

```html
<!-- 传统写法 -->
<span th:text="${user.name != null ? user.name : '游客'}">游客</span>

<!-- Elvis操作符 -->
<span th:text="${user.name ?: '游客'}">游客</span>

更简洁！更易读！
```
:::

---

## 7. ✅ 条件判断方法


### 7.1 真假判断


**布尔运算工具**：让你在模板里做逻辑判断

```
核心方法：
#bools.isTrue(obj)     - 判断是否为true
#bools.isFalse(obj)    - 判断是否为false  
#bools.and(b1, b2)     - 逻辑与
#bools.or(b1, b2)      - 逻辑或
#bools.not(bool)       - 逻辑非
```

**实战场景**：

```html
<!-- VIP且已认证用户显示特权 -->
<div th:if="${#bools.and(user.isVip, user.verified)}">
    <span class="privilege">VIP特权</span>
</div>

<!-- 优惠活动：会员或新用户 -->
<div th:if="${#bools.or(user.isMember, user.isNewUser)}">
    <p class="discount-tip">恭喜获得专属优惠！</p>
</div>

<!-- 非VIP用户的广告 -->
<div th:if="${#bools.not(user.isVip)}">
    <div class="ad-banner">开通VIP去广告</div>
</div>

<!-- 复杂权限判断 -->
<button th:if="${#bools.and(
                    #bools.or(user.isAdmin, user.isModerator),
                    user.emailVerified
                 )}">
    管理后台
</button>
```

### 7.2 空值判断


**null值处理**：防止空指针异常

```
#objects.nullSafe(obj, default)  - 空值安全处理
obj?.property                    - 安全导航操作符
```

**安全编码示例**：

```html
<!-- 安全获取嵌套属性 -->
<span th:text="${user?.profile?.nickname ?: '未设置'}">
    未设置
</span>

<!-- 列表安全处理 -->
<div th:if="${orders != null and !#lists.isEmpty(orders)}">
    <p>共 <span th:text="${#lists.size(orders)}">0</span> 个订单</p>
</div>

<!-- 对象属性安全访问 -->
<div th:with="addr=${user?.address}">
    <p th:if="${addr != null}">
        地址: <span th:text="${addr.detail}">详细地址</span>
    </p>
    <p th:if="${addr == null}">请设置收货地址</p>
</div>
```

---

## 8. 🎨 格式化方法


### 8.1 货币格式化


**本地化货币显示**

```
#numbers.formatCurrency(amount)        - 默认货币符号
#numbers.formatCurrency(amount, locale) - 指定地区货币
```

**多地区支持**：

```html
<!-- 中国地区：人民币 -->
<span th:text="${#numbers.formatCurrency(price, 'zh_CN')}">
    ¥100.00
</span>

<!-- 美国地区：美元 -->
<span th:text="${#numbers.formatCurrency(price, 'en_US')}">
    $100.00
</span>

<!-- 自动适配用户地区 -->
<span th:text="${#numbers.formatCurrency(
                price, 
                #locale.current()
              )}">
    货币金额
</span>
```

### 8.2 百分比格式化


**进度、比率、折扣显示**

```html
<!-- 任务完成度 -->
<div class="progress">
    <div class="progress-bar" 
         th:style="'width:' + ${progress * 100} + '%'">
        <span th:text="${#numbers.formatPercent(progress, 1, 0)}">
            50%
        </span>
    </div>
</div>

<!-- 商品折扣 -->
<span class="discount-tag" 
      th:text="${#numbers.formatPercent(1 - discount, 1, 0)}">
    8折
</span>

<!-- 转化率统计 -->
<tr>
    <td>转化率:</td>
    <td th:text="${#numbers.formatPercent(
                    converted / total, 
                    1, 2
                  )}">
        12.34%
    </td>
</tr>
```

### 8.3 文件大小格式化


**友好的存储单位显示**

```html
<!-- 文件大小显示（需要自定义工具方法） -->
<span th:text="${#numbers.formatFileSize(file.size)}">
    1.5 MB
</span>

<!-- 手动格式化示例 -->
<span th:if="${fileSize < 1024}" th:text="${fileSize + ' B'}"></span>
<span th:if="${fileSize >= 1024 and fileSize < 1048576}" 
      th:text="${#numbers.formatDecimal(fileSize/1024, 1, 2) + ' KB'}">
</span>
<span th:if="${fileSize >= 1048576}" 
      th:text="${#numbers.formatDecimal(fileSize/1048576, 1, 2) + ' MB'}">
</span>
```

---

## 9. 🚀 综合实战案例


### 9.1 电商商品列表页


```html
<div class="product-list">
    <!-- 商品筛选结果提示 -->
    <div class="filter-result">
        <span th:if="${!#lists.isEmpty(products)}">
            找到 <strong th:text="${#lists.size(products)}">0</strong> 件商品
        </span>
        <span th:if="${#lists.isEmpty(products)}">
            暂无符合条件的商品
        </span>
    </div>
    
    <!-- 商品列表 -->
    <div th:each="product, stat : ${products}" class="product-item">
        <!-- 商品序号 -->
        <span class="item-number" th:text="${stat.count}">1</span>
        
        <!-- 商品名称：超过20字截断 -->
        <h3 th:text="${#strings.length(product.name) > 20 ? 
                      #strings.substring(product.name, 0, 20) + '...' : 
                      product.name}">
            商品名称
        </h3>
        
        <!-- 价格显示 -->
        <div class="price-box">
            <!-- 原价 -->
            <span class="original-price" 
                  th:if="${product.discount < 1}"
                  th:text="'¥' + ${#numbers.formatDecimal(product.price, 1, 2)}">
                ¥100.00
            </span>
            
            <!-- 折后价 -->
            <span class="sale-price">
                ¥<span th:text="${#numbers.formatDecimal(
                                  product.price * product.discount, 
                                  1, 2)}">
                    80.00
                </span>
            </span>
            
            <!-- 折扣标签 -->
            <span th:if="${product.discount < 1}" 
                  class="discount-tag"
                  th:text="${#numbers.formatPercent(product.discount, 1, 0)}">
                8折
            </span>
        </div>
        
        <!-- 库存状态 -->
        <div class="stock-status">
            <span th:if="${product.stock > 100}" class="in-stock">
                库存充足
            </span>
            <span th:if="${product.stock > 0 and product.stock <= 100}" 
                  class="low-stock">
                仅剩 <span th:text="${product.stock}">10</span> 件
            </span>
            <span th:if="${product.stock == 0}" class="out-stock">
                已售罄
            </span>
        </div>
        
        <!-- 上架时间 -->
        <small class="publish-time">
            <span th:if="${#dates.createNow().getTime() - product.createTime.getTime() < 86400000}">
                🔥 今日上新
            </span>
            <span th:unless="${#dates.createNow().getTime() - product.createTime.getTime() < 86400000}">
                上架于 <span th:text="${#dates.format(product.createTime, 'MM-dd')}">
                    09-23
                </span>
            </span>
        </small>
    </div>
</div>
```

### 9.2 用户个人中心页


```html
<div class="user-profile">
    <!-- 用户基本信息 -->
    <div class="user-info">
        <!-- 用户名：首字母大写 -->
        <h2 th:text="${#strings.capitalize(user.nickname ?: '游客')}">
            Guest
        </h2>
        
        <!-- VIP标识 -->
        <span th:if="${#lists.contains(user.roles, 'VIP')}" 
              class="vip-badge">
            VIP会员
        </span>
        
        <!-- 注册时长 -->
        <p class="register-time">
            注册于 
            <span th:text="${#dates.format(user.registerTime, 'yyyy年MM月')}">
                2025年9月
            </span>
            (已注册 
            <span th:text="${#numbers.formatInteger(
                            (#dates.createNow().getTime() - user.registerTime.getTime()) 
                            / 86400000, 
                            1)}">
                30
            </span> 天)
        </p>
    </div>
    
    <!-- 订单统计 -->
    <div class="order-stats">
        <div class="stat-item">
            <span class="label">全部订单</span>
            <span class="value" th:text="${#lists.size(user.orders)}">0</span>
        </div>
        
        <div class="stat-item">
            <span class="label">累计消费</span>
            <span class="value">
                ¥<span th:text="${#numbers.formatDecimal(
                                  #aggregates.sum(user.orders.![amount]), 
                                  1, 2)}">
                    0.00
                </span>
            </span>
        </div>
        
        <div class="stat-item">
            <span class="label">平均客单价</span>
            <span class="value">
                ¥<span th:text="${#lists.isEmpty(user.orders) ? 0 : 
                                  #numbers.formatDecimal(
                                    #aggregates.avg(user.orders.![amount]), 
                                    1, 2)}">
                    0.00
                </span>
            </span>
        </div>
    </div>
    
    <!-- 地址信息 -->
    <div class="address-list">
        <h3>收货地址</h3>
        <div th:if="${#lists.isEmpty(user.addresses)}">
            <p class="empty-tip">还没有收货地址，快去添加吧~</p>
        </div>
        
        <div th:each="addr : ${user.addresses}" class="address-item">
            <!-- 默认地址标识 -->
            <span th:if="${addr.isDefault}" class="default-tag">默认</span>
            
            <!-- 收货人 -->
            <p class="receiver" th:text="${addr.name}">收货人</p>
            
            <!-- 电话：隐藏中间4位 -->
            <p class="phone">
                <span th:text="${#strings.substring(addr.phone, 0, 3)}">138</span>
                ****
                <span th:text="${#strings.substring(addr.phone, 7, 11)}">8888</span>
            </p>
            
            <!-- 详细地址 -->
            <p class="detail" th:text="${addr.province + addr.city + addr.detail}">
                详细地址
            </p>
        </div>
    </div>
</div>
```

### 9.3 文章列表页


```html
<div class="article-list">
    <!-- 搜索结果提示 -->
    <div th:if="${param.keyword != null}" class="search-result">
        <p>
            搜索 "<strong th:text="${param.keyword}">关键词</strong>" 
            找到 <span th:text="${#lists.size(articles)}">0</span> 篇文章
        </p>
    </div>
    
    <!-- 文章列表 -->
    <div th:each="article : ${articles}" class="article-item">
        <!-- 文章标题：关键词高亮 -->
        <h3 th:if="${param.keyword != null and 
                     #strings.contains(article.title, param.keyword)}">
            <span th:text="${#strings.replace(
                            article.title, 
                            param.keyword, 
                            '<mark>' + param.keyword + '</mark>'
                          )}"
                  th:utext="${#strings.replace(
                              article.title, 
                              param.keyword, 
                              '<mark>' + param.keyword + '</mark>'
                            )}">
                文章标题
            </span>
        </h3>
        
        <!-- 文章摘要 -->
        <p class="summary" 
           th:text="${#strings.abbreviate(article.content, 100)}">
            文章摘要...
        </p>
        
        <!-- 文章标签 -->
        <div class="tags">
            <span th:each="tag : ${#strings.arraySplit(article.tags, ',')}"
                  class="tag"
                  th:text="${tag}">
                标签
            </span>
        </div>
        
        <!-- 文章统计 -->
        <div class="article-stats">
            <!-- 阅读量 -->
            <span class="views">
                <i class="icon-view"></i>
                <span th:text="${article.viewCount >= 10000 ? 
                                #numbers.formatDecimal(article.viewCount/10000, 1, 1) + 'w' :
                                article.viewCount}">
                    1000
                </span>
            </span>
            
            <!-- 点赞数 -->
            <span class="likes">
                <i class="icon-like"></i>
                <span th:text="${article.likeCount}">100</span>
            </span>
            
            <!-- 评论数 -->
            <span class="comments">
                <i class="icon-comment"></i>
                <span th:text="${article.commentCount}">50</span>
            </span>
            
            <!-- 发布时间：智能显示 -->
            <span class="time">
                <span th:if="${(#dates.createNow().getTime() - article.publishTime.getTime()) < 3600000}">
                    <span th:text="${(#dates.createNow().getTime() - article.publishTime.getTime()) / 60000}">
                        30
                    </span> 分钟前
                </span>
                <span th:if="${(#dates.createNow().getTime() - article.publishTime.getTime()) >= 3600000 and
                              (#dates.createNow().getTime() - article.publishTime.getTime()) < 86400000}">
                    <span th:text="${(#dates.createNow().getTime() - article.publishTime.getTime()) / 3600000}">
                        5
                    </span> 小时前
                </span>
                <span th:if="${(#dates.createNow().getTime() - article.publishTime.getTime()) >= 86400000}">
                    <span th:text="${#dates.format(article.publishTime, 'MM-dd')}">
                        09-23
                    </span>
                </span>
            </span>
        </div>
    </div>
</div>
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心方法


**🔤 字符串处理**
```
✅ 大小写转换：capitalize(), toUpperCase(), toLowerCase()
✅ 截取拼接：substring(), concat(), append(), prepend()
✅ 查找判断：contains(), startsWith(), endsWith()
✅ 长度检查：isEmpty(), length(), trim()
```

**🔢 数字处理**
```
✅ 格式化：formatDecimal(), formatInteger(), formatPercent()
✅ 序列生成：sequence() - 分页、评分常用
✅ 数组操作：length(), contains()
```

**📅 日期处理**
```
✅ 格式化：format(date, 'yyyy-MM-dd HH:mm')
✅ 属性提取：year(), month(), day(), hour()
✅ 对比判断：before(), after()
```

**📦 集合操作**
```
✅ 基础判断：isEmpty(), size(), contains()
✅ 排序操作：sort()
✅ Map操作：containsKey(), containsValue()
✅ 聚合计算：sum(), avg(), max(), min()
```

### 10.2 实战技巧总结


**🎯 常用组合技巧**

**1️⃣ 字符串截断+省略号**
```html
<p th:text="${#strings.length(text) > 50 ? 
             #strings.substring(text, 0, 50) + '...' : 
             text}">
    内容
</p>
```

**2️⃣ 价格格式化+货币符号**
```html
<span>¥<span th:text="${#numbers.formatDecimal(price, 1, 2)}">99.00</span></span>
```

**3️⃣ 时间智能显示**
```html
<span th:if="${时间差 < 1小时}">XX分钟前</span>
<span th:if="${时间差 >= 1小时 and 时间差 < 1天}">XX小时前</span>
<span th:if="${时间差 >= 1天}">具体日期</span>
```

**4️⃣ Elvis操作符简化判空**
```html
<!-- 简洁写法 -->
<span th:text="${user.name ?: '游客'}">游客</span>

<!-- 多层默认值 -->
<span th:text="${user.realName ?: user.nickname ?: '匿名'}">匿名</span>
```

### 10.3 学习路径建议


**📚 学习进阶路线**

```
第一阶段：基础掌握
├── 字符串基础方法（大小写、截取、判空）
├── 数字格式化（小数位、千分位）
└── 日期基础格式化

第二阶段：进阶应用
├── 集合操作（遍历、过滤、排序）
├── 条件判断组合使用
└── 类型转换与默认值

第三阶段：综合实战
├── 电商页面数据展示
├── 用户中心信息处理
└── 复杂业务场景应用
```

**🔥 高频使用场景TOP 5**

| 排名 | 场景 | 常用方法 | 使用频率 |
|------|------|----------|----------|
| 1 | **商品价格显示** | `formatDecimal()` | ⭐⭐⭐⭐⭐ |
| 2 | **文本截断** | `substring() + '...'` | ⭐⭐⭐⭐⭐ |
| 3 | **日期格式化** | `format(date, pattern)` | ⭐⭐⭐⭐ |
| 4 | **空值处理** | `?: 默认值` | ⭐⭐⭐⭐ |
| 5 | **集合判空** | `isEmpty()` | ⭐⭐⭐ |

### 10.4 注意事项与最佳实践


::: warning ⚠️ 常见错误

**❌ 错误1：直接判空不检查null**
```html
<!-- 错误 -->
<div th:if="${#strings.isEmpty(text)}">...</div>

<!-- 正确 -->
<div th:if="${text == null or #strings.isEmpty(text)}">...</div>
```

**❌ 错误2：过度使用代码块展示简单逻辑**
```html
<!-- 不推荐 -->
<div th:if="${condition}">
    <div th:text="${value1}"></div>
</div>
<div th:unless="${condition}">
    <div th:text="${value2}"></div>
</div>

<!-- 推荐 -->
<div th:text="${condition ? value1 : value2}"></div>
```

**❌ 错误3：忘记格式化数字小数位**
```html
<!-- 错误：可能显示 99.9999999 -->
<span th:text="${price}">价格</span>

<!-- 正确：始终显示2位小数 -->
<span th:text="${#numbers.formatDecimal(price, 1, 2)}">99.00</span>
```
:::

::: tip 💡 性能优化建议

**✅ 使用th:with减少重复计算**
```html
<!-- 优化前：重复计算 -->
<span th:text="${#strings.toUpperCase(text)}"></span>
<span th:text="${#strings.length(#strings.toUpperCase(text))}"></span>

<!-- 优化后：计算一次 -->
<div th:with="upperText=${#strings.toUpperCase(text)}">
    <span th:text="${upperText}"></span>
    <span th:text="${#strings.length(upperText)}"></span>
</div>
```

**✅ 复杂逻辑后端处理**
```
简单格式化 → 前端Thymeleaf处理 ✅
复杂业务计算 → 后端Java处理 ✅

记住：Thymeleaf是展示层，不是业务逻辑层！
```
:::

### 10.5 快速查询参考表


**📋 方法速查卡片**

```
🔤 字符串：#strings.XXX
├── capitalize()      - 首字母大写
├── substring(s,i,j)  - 截取
├── contains(s,sub)   - 包含判断
└── isEmpty(s)        - 判空

🔢 数字：#numbers.XXX  
├── formatDecimal(n,i,d) - 格式化小数
├── formatInteger(n,i)   - 格式化整数
└── sequence(from,to)    - 生成序列

📅 日期：#dates.XXX
├── format(d,pattern) - 格式化
├── year(d), month(d) - 提取属性
└── createNow()       - 当前时间

📦 集合：#lists.XXX
├── isEmpty(list)  - 判空
├── size(list)     - 大小
└── contains(l,e)  - 包含

✅ 布尔：#bools.XXX
├── isTrue(b)   - 真假
├── and(b1,b2)  - 逻辑与
└── or(b1,b2)   - 逻辑或
```

**🎯 一分钟记忆法**

```
字符串 - 增删改查
├── 增：append, prepend
├── 删：substring, trim
├── 改：replace, toUpperCase
└── 查：contains, indexOf

数字 - 格式转换
├── 格式化：formatXXX
├── 转换：toString, toInteger
└── 计算：sequence

日期 - 格式属性
├── 格式：format
├── 属性：year, month, day
└── 对比：before, after

集合 - 增删改查
├── 查：isEmpty, size
├── 改：sort
├── 删：remove
└── 增：add
```

**核心记忆口诀**：
```
字符串处理用strings，大小截取常用功
数字格式formatDecimal，日期format加模式
集合判空用isEmpty，Elvis简化条件判
工具方法虽强大，复杂逻辑后端算
```

---

**🎉 学习完成检查清单**

- [ ] 理解表达式工具方法的作用和价值
- [ ] 掌握字符串的大小写、截取、查找操作
- [ ] 会用数字格式化显示价格和百分比
- [ ] 能够格式化日期并提取日期属性
- [ ] 熟悉集合的基础操作和遍历
- [ ] 理解Elvis操作符的使用场景
- [ ] 能够组合使用多个工具方法解决实际问题
- [ ] 知道什么场景用Thymeleaf，什么场景用Java

**💪 下一步学习建议**：
1. 动手实践：把每个示例代码都运行一遍
2. 项目应用：在实际项目中尝试使用这些方法
3. 查阅文档：遇到问题及时查阅官方文档
4. 总结归纳：建立自己的常用方法库

**记住**：工具方法是为了简化开发，让模板更清晰。不要为了用而用，选择最合适的方式最重要！