---
title: 1、Thymeleaf内置上下文对象
---
## 📚 目录


1. [内置对象概述](#1-内置对象概述)
2. [上下文内置对象详解](#2-上下文内置对象详解)
3. [Web上下文对象](#3-Web上下文对象)
4. [实用工具对象](#4-实用工具对象)
5. [核心要点总结](#5-核心要点总结)

---

# 1. 🎯 内置对象概述



## 1.1 什么是内置对象



**通俗理解**：
内置对象就像Thymeleaf给你准备好的"工具箱"，里面装了很多现成的工具，可以直接拿来用，不需要自己再去创建。

```
类比说明：
厨房里的工具 → Thymeleaf的内置对象
- 刀具        → #strings（字符串工具）
- 计算器      → #numbers（数字工具）
- 时钟        → #dates（日期工具）
- 冰箱        → session（会话对象）
```

**核心作用**：
- 🔧 **简化开发** - 不用写Java代码就能处理常见操作
- 🎯 **提高效率** - 常用功能开箱即用
- 📦 **统一规范** - 提供标准的访问方式

## 1.2 内置对象分类



```
Thymeleaf内置对象体系：
┌─────────────────────────────────┐
│      Thymeleaf内置对象           │
├─────────────────────────────────┤
│                                 │
│  1. 基础Web对象（访问请求数据）   │
│     └─ #request, #session...    │
│                                 │
│  2. 工具类对象（处理数据）        │
│     └─ #strings, #dates...      │
│                                 │
│  3. 环境对象（获取配置）          │
│     └─ #locale, #ctx...         │
│                                 │
└─────────────────────────────────┘
```

**使用特点**：
- 以 `#` 开头的是工具类对象（如 `#strings`）
- 不带 `#` 的是Web上下文对象（如 `session`）

---

# 2. 🌐 上下文内置对象详解



## 2.1 request 请求对象



**是什么**：
`request` 对象代表当前的HTTP请求，包含了用户发来的所有信息。

**通俗比喻**：
```
request就像一封信：
信封：请求头（浏览器信息、Cookie等）
信纸：请求参数（表单数据、URL参数）
邮戳：请求属性（服务器临时存储的数据）
```

**💡 实用场景**

| 场景 | 说明 | 使用示例 |
|------|------|---------|
| 获取请求参数 | 读取URL或表单数据 | `${param.username}` |
| 获取请求头 | 读取浏览器信息 | `${#request.getHeader('User-Agent')}` |
| 获取请求路径 | 获取当前页面URL | `${#request.requestURI}` |

**基础用法**：
```html
<!-- 获取请求参数：地址栏 ?name=张三 -->
<p>用户名：<span th:text="${param.name}">默认值</span></p>

<!-- 获取请求路径 -->
<p>当前页面：<span th:text="${#request.requestURI}"></span></p>

<!-- 获取客户端IP -->
<p>访客IP：<span th:text="${#request.remoteAddr}"></span></p>
```

**常用方法速查**：
```
#request对象常用方法：

├─ getParameter(name)    → 获取单个参数
├─ getParameterValues()  → 获取参数数组
├─ getHeader(name)       → 获取请求头
├─ requestURI            → 获取请求路径
└─ remoteAddr            → 获取客户端IP
```

## 2.2 session 会话对象



**是什么**：
`session` 是服务器为每个用户创建的"临时存储空间"，用户关闭浏览器前一直有效。

**通俗比喻**：
```
session就像购物车：
- 你逛超市时的临时购物车
- 只要没结账，东西一直在
- 结账离开后（关闭浏览器），购物车就清空了
```

**💡 实用场景**：

📱 **场景1：用户登录状态保持**
```html
<!-- 显示登录用户信息 -->
<div th:if="${session.user != null}">
    <p>欢迎回来，<span th:text="${session.user.name}"></span></p>
    <a href="/logout">退出登录</a>
</div>

<div th:if="${session.user == null}">
    <a href="/login">请登录</a>
</div>
```

📱 **场景2：购物车数据**
```html
<!-- 显示购物车商品数量 -->
<span class="cart-count" th:text="${session.cartItems?.size() ?: 0}">0</span>
```

**存储与读取**：
```java
// 后端存储数据到session
session.setAttribute("username", "张三");
session.setAttribute("role", "管理员");
```

```html
<!-- 前端读取session数据 -->
<p th:text="${session.username}">游客</p>
<p th:text="${session.role}">普通用户</p>
```

**⚠️ 注意事项**：
> session数据存在服务器内存中，不要存储太大的数据，会影响性能

## 2.3 application 应用对象



**是什么**：
`application` 是整个Web应用共享的全局存储空间，所有用户都能访问。

**通俗比喻**：
```
request  → 便签纸（用完就扔）
session  → 个人储物柜（每人一个）
application → 公共布告栏（所有人共享）
```

**💡 实用场景**：

📊 **场景1：网站访问统计**
```html
<!-- 显示网站总访问量 -->
<footer>
    <p>本站已被访问 <span th:text="${application.visitCount}">0</span> 次</p>
</footer>
```

📊 **场景2：全局配置信息**
```html
<!-- 显示网站名称和版本 -->
<header>
    <h1 th:text="${application.siteName}">我的网站</h1>
    <small th:text="'v' + ${application.version}">v1.0</small>
</header>
```

**对比理解**：

| 对象 | 生命周期 | 使用场景 | 存储位置 |
|------|---------|---------|---------|
| **request** | `一次请求` | 临时数据传递 | 服务器内存 |
| **session** | `一次会话` | 用户个人数据 | 服务器内存 |
| **application** | `应用启动到关闭` | 全局共享数据 | 服务器内存 |

## 2.4 param 请求参数



**是什么**：
`param` 是专门用来获取URL参数和表单数据的对象。

**通俗理解**：
```
URL：http://localhost/search?keyword=手机&page=2

param就是把这些参数打包好：
├─ param.keyword = "手机"
└─ param.page = "2"
```

**📝 获取单个参数**：
```html
<!-- URL: /user?id=123 -->
<p>用户ID：<span th:text="${param.id}">未知</span></p>

<!-- URL: /search?q=Thymeleaf -->
<p>搜索关键词：<span th:text="${param.q}">无</span></p>
```

**📝 获取多个同名参数**：
```html
<!-- URL: /filter?color=red&color=blue&color=green -->
<ul>
    <li th:each="color : ${param.color}" th:text="${color}"></li>
</ul>
<!-- 输出：red, blue, green -->
```

**📝 参数默认值处理**：
```html
<!-- 使用三元运算符设置默认值 -->
<p th:text="${param.page != null ? param.page : '1'}">1</p>

<!-- 使用Elvis运算符（更简洁） -->
<p th:text="${param.page ?: '1'}">1</p>
```

**实际应用示例**：
```html
<!-- 搜索表单回显 -->
<form action="/search" method="get">
    <!-- 保持用户输入的搜索词 -->
    <input type="text" 
           name="keyword" 
           th:value="${param.keyword}"
           placeholder="请输入搜索关键词">
    
    <!-- 保持选择的分类 -->
    <select name="category">
        <option value="all" 
                th:selected="${param.category == 'all'}">全部</option>
        <option value="book" 
                th:selected="${param.category == 'book'}">图书</option>
    </select>
    
    <button type="submit">搜索</button>
</form>
```

## 2.5 locale 区域对象



**是什么**：
`locale` 表示当前用户的语言和地区设置，用于国际化支持。

**通俗理解**：
```
locale就像"语言切换器"：
中文用户：zh_CN（中文-中国）
英文用户：en_US（英文-美国）
日文用户：ja_JP（日文-日本）
```

**🌍 实用场景**：

**场景1：显示当前语言**
```html
<!-- 显示用户当前使用的语言 -->
<p>当前语言：<span th:text="${#locale.language}"></span></p>
<!-- 输出：zh（中文） 或 en（英文） -->

<!-- 显示完整的区域信息 -->
<p>区域设置：<span th:text="${#locale}"></span></p>
<!-- 输出：zh_CN 或 en_US -->
```

**场景2：根据语言显示不同内容**
```html
<!-- 中英文切换欢迎语 -->
<h1 th:text="${#locale.language == 'zh' ? '欢迎' : 'Welcome'}"></h1>

<!-- 日期格式根据地区调整 -->
<p th:text="${#dates.format(today, 
#    #locale.language == 'zh' ? 'yyyy年MM月dd日' : 'MM/dd/yyyy')}"></p>
```

**常用属性**：
```
#locale对象属性：

├─ language     → 语言代码（zh、en）
├─ country      → 国家代码（CN、US）
├─ displayName  → 完整显示名称
└─ toString()   → 完整区域代码（zh_CN）
```

---

# 3. 🛠 Web上下文对象



## 3.1 #ctx 上下文对象



**是什么**：
`#ctx` 是Thymeleaf的核心上下文对象，可以访问所有变量和配置。

**通俗理解**：
```
#ctx就像"总管家"：

- 管理着所有的数据
- 知道所有的配置
- 协调各个对象的工作
```

**💡 实用方法**：

**检查变量是否存在**：
```html
<!-- 安全检查变量 -->
<div th:if="${#ctx.containsVariable('user')}">
    <p th:text="${user.name}"></p>
</div>

<!-- 等价于 -->
<div th:if="${user != null}">
    <p th:text="${user.name}"></p>
</div>
```

**获取所有变量名**：
```html
<!-- 调试：查看当前有哪些变量 -->
<ul>
    <li th:each="varName : ${#ctx.variableNames}" 
        th:text="${varName}"></li>
</ul>
```

## 3.2 #vars 变量访问对象



**是什么**：
`#vars` 用于动态访问变量，特别是变量名本身也是动态的情况。

**💡 动态访问示例**：
```html
<!-- 场景：根据用户角色动态显示不同菜单 -->
<div th:with="menuVar='menu_' + ${session.role}">
    <!-- 动态访问变量：menu_admin 或 menu_user -->
    <ul th:each="item : ${#vars[menuVar]}">
        <li th:text="${item}"></li>
    </ul>
</div>
```

**实际应用**：
```html
<!-- 多语言动态切换 -->
<p th:with="msgKey='msg.' + ${#locale.language}"
   th:text="${#vars[msgKey]}">默认消息</p>

<!-- 
如果语言是zh，访问 msg.zh
如果语言是en，访问 msg.en
-->
```

## 3.3 #request 增强功能



**除了基础功能，#request还提供了很多实用方法**：

**📍 获取完整URL信息**：
```html
<!-- 获取请求协议 -->
<p>协议：<span th:text="${#request.scheme}"></span></p>
<!-- 输出：http 或 https -->

<!-- 获取服务器名 -->
<p>域名：<span th:text="${#request.serverName}"></span></p>
<!-- 输出：localhost 或 www.example.com -->

<!-- 获取端口号 -->
<p>端口：<span th:text="${#request.serverPort}"></span></p>
<!-- 输出：8080 -->

<!-- 组合：完整URL -->
<a th:href="${#request.scheme + '://' + 
#              #request.serverName + ':' + 
#              #request.serverPort + '/home'}">首页</a>
```

**📍 请求方法判断**：
```html
<!-- 判断是GET还是POST -->
<div th:if="${#request.method == 'GET'}">
    <p>这是GET请求</p>
</div>

<div th:if="${#request.method == 'POST'}">
    <p>这是POST请求，可能在提交表单</p>
</div>
```

**📍 请求头信息**：
```html
<!-- 获取浏览器信息 -->
<p th:text="${#request.getHeader('User-Agent')}"></p>

<!-- 获取来源页面 -->
<p>从哪来：<span th:text="${#request.getHeader('Referer') ?: '直接访问'}"></span></p>

<!-- 检查是否为AJAX请求 -->
<div th:if="${#request.getHeader('X-Requested-With') == 'XMLHttpRequest'}">
    <p>这是一个AJAX请求</p>
</div>
```

---

# 4. 🧰 实用工具对象



## 4.1 #strings 字符串工具



**核心功能速查**：

| 方法 | 作用 | 示例 |
|------|------|------|
| `isEmpty()` | 判断空字符串 | `${#strings.isEmpty(name)}` |
| `substring()` | 截取字符串 | `${#strings.substring(text, 0, 10)}` |
| `toUpperCase()` | 转大写 | `${#strings.toUpperCase(name)}` |
| `toLowerCase()` | 转小写 | `${#strings.toLowerCase(name)}` |
| `trim()` | 去空格 | `${#strings.trim(input)}` |

**📝 实用示例**：

**文本截断（防止过长）**：
```html
<!-- 文章摘要：超过50字显示省略号 -->
<p th:text="${#strings.length(article.content) > 50 ? 
#              #strings.substring(article.content, 0, 50) + '...' : 
              article.content}"></p>
```

**空值安全处理**：
```html
<!-- 如果用户名为空，显示默认值 -->
<p th:text="${#strings.isEmpty(username) ? '游客' : username}"></p>

<!-- 去除前后空格 -->
<input th:value="${#strings.trim(param.keyword)}">
```

**大小写转换**：
```html
<!-- 用户名首字母大写 -->
<span th:text="${#strings.capitalize(username)}"></span>

<!-- 全部转大写（用于代码、标识符） -->
<code th:text="${#strings.toUpperCase(code)}"></code>
```

## 4.2 #numbers 数字工具



**核心功能**：

```
#numbers 数字格式化工具：

├─ formatDecimal()     → 格式化小数
├─ formatInteger()     → 格式化整数
├─ formatPercent()     → 格式化百分比
└─ formatCurrency()    → 格式化货币
```

**💰 实用场景**：

**价格格式化**：
```html
<!-- 显示商品价格：保留2位小数 -->
<p>价格：¥<span th:text="${#numbers.formatDecimal(price, 1, 2)}"></span></p>
<!-- 输出：¥1,234.56 -->

<!-- 千位分隔符 -->
<p th:text="${#numbers.formatInteger(totalSales, 3)}"></p>
<!-- 输出：1,234,567 -->
```

**百分比显示**：
```html
<!-- 折扣：0.75 显示为 75% -->
<span class="discount" 
      th:text="${#numbers.formatPercent(discount, 1, 0)}"></span>

<!-- 完成度进度条 -->
<div class="progress">
    <div class="bar" 
         th:style="'width:' + ${#numbers.formatPercent(progress, 1, 0)}"></div>
</div>
```

**参数说明**：
```
formatDecimal(数字, 整数位数, 小数位数)
├─ 数字：要格式化的数值
├─ 整数位数：整数部分最少位数（不足补0）
└─ 小数位数：小数部分保留位数
```

## 4.3 #dates 日期工具



**核心功能**：

| 方法 | 作用 | 输出示例 |
|------|------|---------|
| `format()` | 格式化日期 | `2025-09-23` |
| `day()` | 获取天数 | `23` |
| `month()` | 获取月份 | `9` |
| `year()` | 获取年份 | `2025` |
| `createNow()` | 创建当前时间 | 当前日期时间 |

**📅 实用示例**：

**日期格式化**：
```html
<!-- 文章发布时间 -->
<time th:text="${#dates.format(article.createTime, 'yyyy-MM-dd HH:mm')}"></time>
<!-- 输出：2025-09-23 14:30 -->

<!-- 中文日期格式 -->
<p th:text="${#dates.format(date, 'yyyy年MM月dd日')}"></p>
<!-- 输出：2025年09月23日 -->
```

**相对时间显示**：
```html
<!-- 显示"今天"、"昨天"、具体日期 -->
<span th:with="today=${#dates.createNow()},
               articleDay=${#dates.day(article.createTime)},
               todayDay=${#dates.day(today)}">
    <span th:if="${articleDay == todayDay}">今天</span>
    <span th:if="${articleDay == todayDay - 1}">昨天</span>
    <span th:if="${articleDay < todayDay - 1}" 
          th:text="${#dates.format(article.createTime, 'MM-dd')}"></span>
</span>
```

**时间计算**：
```html
<!-- 创建当前日期 -->
<p>当前时间：<span th:text="${#dates.format(#dates.createNow(), 'yyyy-MM-dd HH:mm:ss')}"></span></p>

<!-- 提取日期部分 -->
<p>今年是：<span th:text="${#dates.year(#dates.createNow())}"></span>年</p>
<p>这个月是：<span th:text="${#dates.month(#dates.createNow())}"></span>月</p>
```

## 4.4 #lists 列表工具



**核心功能**：

```
#lists 列表操作工具：

├─ isEmpty()     → 判断列表是否为空
├─ size()        → 获取列表大小
├─ contains()    → 判断是否包含元素
├─ sort()        → 列表排序
└─ toArray()     → 转为数组
```

**📋 实用示例**：

**列表判空**：
```html
<!-- 商品列表展示 -->
<div th:if="${#lists.isEmpty(productList)}">
    <p>暂无商品</p>
</div>

<div th:if="${!#lists.isEmpty(productList)}">
    <p>共有 <span th:text="${#lists.size(productList)}"></span> 件商品</p>
    <ul th:each="product : ${productList}">
        <li th:text="${product.name}"></li>
    </ul>
</div>
```

**列表包含判断**：
```html
<!-- 检查用户是否有特定权限 -->
<button th:if="${#lists.contains(user.permissions, 'DELETE')}" 
        class="btn-delete">删除</button>

<!-- 检查商品是否在收藏夹 -->
<span th:if="${#lists.contains(favoriteIds, product.id)}" 
      class="favorited">❤️ 已收藏</span>
```

## 4.5 #maps 映射工具



**核心功能**：

```
#maps Map操作工具：

├─ isEmpty()        → 判断Map是否为空
├─ size()           → 获取Map大小
├─ containsKey()    → 判断是否包含键
├─ containsValue()  → 判断是否包含值
└─ keys()           → 获取所有键
```

**🗂️ 实用示例**：

**配置信息展示**：
```html
<!-- 显示系统配置 -->
<table th:if="${!#maps.isEmpty(config)}">
    <tr th:each="entry : ${config}">
        <td th:text="${entry.key}">配置项</td>
        <td th:text="${entry.value}">配置值</td>
    </tr>
</table>
```

**动态键值访问**：
```html
<!-- 检查配置项是否存在 -->
<div th:if="${#maps.containsKey(settings, 'theme')}">
    <p>当前主题：<span th:text="${settings.theme}"></span></p>
</div>

<!-- 获取所有配置项名称 -->
<select>
    <option th:each="key : ${#maps.keys(settings)}" 
            th:value="${key}" 
            th:text="${key}"></option>
</select>
```

---

# 5. 📋 核心要点总结



## 5.1 必须掌握的核心概念



```
🔸 内置对象分类：
   ├─ Web对象：request、session、application（存储数据）
   ├─ 工具对象：#strings、#dates、#numbers（处理数据）
   └─ 上下文对象：#ctx、#locale、param（获取信息）

🔸 使用规则：
   ├─ 以#开头的是工具类对象
   ├─ 不带#的是Web上下文对象
   └─ 都可以直接在模板中使用
```

## 5.2 内置对象使用对比



| 对象 | 生命周期 | 典型用途 | 使用示例 |
|------|---------|---------|---------|
| **request** | `一次请求` | 获取请求信息 | `${#request.requestURI}` |
| **session** | `一次会话` | 用户状态保持 | `${session.user.name}` |
| **application** | `整个应用` | 全局配置数据 | `${application.siteName}` |
| **param** | `当前请求` | 获取请求参数 | `${param.keyword}` |
| **#strings** | `工具方法` | 字符串处理 | `${#strings.isEmpty(name)}` |
| **#dates** | `工具方法` | 日期格式化 | `${#dates.format(date, 'yyyy-MM-dd')}` |

## 5.3 实际应用场景速查



**📱 用户登录场景**：
```html
<!-- 1. 检查登录状态 -->
<div th:if="${session.user != null}">
    欢迎，<span th:text="${session.user.name}"></span>
</div>

<!-- 2. 显示登录时间 -->
<small th:text="'登录时间：' + ${#dates.format(session.loginTime, 'HH:mm')}"></small>

<!-- 3. 根据权限显示功能 -->
<button th:if="${#lists.contains(session.user.roles, 'ADMIN')}">
    管理后台
</button>
```

**📱 搜索结果场景**：
```html
<!-- 1. 显示搜索关键词 -->
<h2>搜索结果：<span th:text="${param.keyword}"></span></h2>

<!-- 2. 显示结果数量 -->
<p>找到 <span th:text="${#lists.size(results)}"></span> 条结果</p>

<!-- 3. 高亮关键词 -->
<p th:each="item : ${results}"
   th:utext="${#strings.replace(item.content, param.keyword, 
              '<mark>' + param.keyword + '</mark>')}"></p>
```

**📱 电商场景**：
```html
<!-- 1. 商品价格格式化 -->
<span class="price" th:text="'¥' + ${#numbers.formatDecimal(product.price, 1, 2)}"></span>

<!-- 2. 折扣显示 -->
<span class="discount" th:text="${#numbers.formatPercent(product.discount, 1, 0)}"></span>

<!-- 3. 上架时间 -->
<time th:text="${#dates.format(product.createTime, 'yyyy-MM-dd')}"></time>
```

## 5.4 最佳实践建议



**✅ 推荐做法**：
```html
<!-- 1. 使用安全访问运算符 -->
<p th:text="${user?.name}">游客</p>

<!-- 2. 提供默认值 -->
<p th:text="${session.username ?: '未登录'}"></p>

<!-- 3. 组合使用工具对象 -->
<p th:text="${#strings.isEmpty(param.q) ? '请输入搜索词' : 
              '搜索：' + #strings.abbreviate(param.q, 20)}"></p>
```

**❌ 避免做法**：
```html
<!-- 不推荐：直接访问可能为null的对象 -->
<p th:text="${user.name}"></p>  <!-- 可能报错 -->

<!-- 不推荐：过度使用工具对象 -->
<p th:text="${#strings.toUpperCase(#strings.trim(#strings.substring(name, 0, 10)))}"></p>
<!-- 太复杂，应该在后端处理 -->
```

## 5.5 常见问题解答



**Q1：什么时候用#strings，什么时候用Java处理？**
```
简单规则：
✅ 展示层的简单处理 → 用#strings（格式化、截断）
❌ 复杂的业务逻辑 → 在后端Java代码处理
```

**Q2：session和application的区别？**
```
session：
- 每个用户独立的存储空间
- 用户退出后数据消失
- 存储用户个人数据（购物车、登录信息）

application：
- 所有用户共享
- 应用运行期间一直存在
- 存储全局配置（网站名称、访问统计）
```

**Q3：如何在Thymeleaf中调试变量？**
```html
<!-- 方法1：显示所有变量 -->
<div th:each="var : ${#ctx.variableNames}" 
     th:text="${var + ' = ' + #vars[var]}"></div>

<!-- 方法2：检查特定变量 -->
<p th:if="${user != null}" th:text="'User对象存在：' + ${user}"></p>
<p th:if="${user == null}">User对象不存在</p>
```

---

**🎯 学习检查清单**：
- [ ] 理解内置对象的分类和作用
- [ ] 掌握request、session、application的区别
- [ ] 会使用param获取请求参数
- [ ] 熟练使用#strings处理字符串
- [ ] 会用#dates格式化日期
- [ ] 了解#lists和#maps的常用方法

**💡 核心记忆**：
```
内置对象像工具箱，拿来即用不用造
#开头是工具类，处理数据格式好

request存请求信息，session保持会话妙
application全局共享，param参数不能少
字符日期数字列表，工具对象样样好
```