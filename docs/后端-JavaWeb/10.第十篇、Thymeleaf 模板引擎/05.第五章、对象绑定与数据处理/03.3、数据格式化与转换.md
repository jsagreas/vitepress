---
title: 3、数据格式化与转换
---
## 📚 目录

1. [数据格式化基础概念](#1-数据格式化基础概念)
2. [日期时间格式化](#2-日期时间格式化)
3. [数字格式化处理](#3-数字格式化处理)
4. [货币与百分比格式化](#4-货币与百分比格式化)
5. [自定义格式化方案](#5-自定义格式化方案)
6. [时区与精度控制](#6-时区与精度控制)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🎯 数据格式化基础概念


### 1.1 什么是数据格式化


**通俗理解**：就像给数据"化妆"，让它以更友好的方式展示给用户

```
原始数据：2025-09-23T10:30:00  → 格式化后：2025年9月23日 上午10:30
原始数据：12345.6789          → 格式化后：¥12,345.68
原始数据：0.85                → 格式化后：85%
```

**为什么需要格式化**：
- 📱 **用户友好**：让数据更易读易懂
- 🌍 **国际化支持**：适配不同国家地区的习惯
- 💼 **业务规范**：符合特定行业标准
- 🎨 **视觉美观**：提升界面专业度

### 1.2 Thymeleaf格式化核心机制


**两大核心工具**：
```
#dates   → 专门处理日期时间
#numbers → 专门处理数字格式
```

**基本使用模式**：
```html
<!-- 日期格式化模式 -->
<p th:text="${#dates.format(date, 'yyyy-MM-dd')}"></p>

<!-- 数字格式化模式 -->
<p th:text="${#numbers.formatDecimal(price, 1, 2)}"></p>
```

### 1.3 格式化的工作原理


```
数据流转过程：

后端Java对象              Thymeleaf引擎              浏览器展示
   ↓                         ↓                        ↓
Date对象              #dates.format()           "2025-09-23"
12345.67             #numbers.format()          "12,345.67"
0.85                 #numbers.percent()              "85%"
```

---

## 2. 📅 日期时间格式化


### 2.1 基础日期格式化


**常用日期格式模式**：

| 格式符号 | **含义** | **示例** |
|---------|---------|---------|
| `yyyy` | `4位年份` | `2025` |
| `MM` | `2位月份` | `09` |
| `dd` | `2位日期` | `23` |
| `HH` | `24小时制小时` | `14` |
| `mm` | `分钟` | `30` |
| `ss` | `秒` | `45` |
| `E` | `星期` | `星期二` |

**实际应用示例**：

```html
<!-- 控制器传递日期对象 -->
<!-- Date createTime = new Date(); -->

<!-- 1. 标准日期格式 -->
<p th:text="${#dates.format(createTime, 'yyyy-MM-dd')}"></p>
<!-- 输出：2025-09-23 -->

<!-- 2. 完整日期时间 -->
<p th:text="${#dates.format(createTime, 'yyyy年MM月dd日 HH:mm:ss')}"></p>
<!-- 输出：2025年09月23日 14:30:45 -->

<!-- 3. 带星期的格式 -->
<p th:text="${#dates.format(createTime, 'yyyy-MM-dd E')}"></p>
<!-- 输出：2025-09-23 星期二 -->
```

### 2.2 快捷格式化方法


**Thymeleaf提供的便捷方法**：

```html
<!-- 1. 只显示日期部分 -->
<p th:text="${#dates.formatDate(createTime)}"></p>
<!-- 输出：2025-09-23 -->

<!-- 2. 只显示时间部分 -->
<p th:text="${#dates.formatTime(createTime)}"></p>
<!-- 输出：14:30:45 -->

<!-- 3. 显示日期和时间 -->
<p th:text="${#dates.formatDateTime(createTime)}"></p>
<!-- 输出：2025-09-23 14:30:45 -->
```

### 2.3 日期格式自定义


**实战场景示例**：

```html
<!-- 文章发布时间展示 -->
<div class="article-info">
    <!-- 友好的时间格式 -->
    <span th:text="${#dates.format(article.publishTime, 'yyyy年MM月dd日')}"></span>
    
    <!-- 详细时间戳 -->
    <small th:text="${#dates.format(article.publishTime, 'HH:mm')}"></small>
</div>

<!-- 输出效果： -->
<!-- 2025年09月23日 14:30 -->
```

**常用业务格式**：

```html
<!-- 订单创建时间 -->
<p>下单时间：<span th:text="${#dates.format(order.createTime, 'yyyy-MM-dd HH:mm')}"></span></p>

<!-- 活动截止日期 -->
<p>截止日期：<span th:text="${#dates.format(activity.endDate, 'MM月dd日')}"></span></p>

<!-- 用户注册时间 -->
<p>注册于：<span th:text="${#dates.format(user.registerTime, 'yyyy年MM月')}"></span></p>
```

### 2.4 空值安全处理


**避免空指针异常**：

```html
<!-- 使用条件判断 -->
<p th:if="${user.lastLoginTime != null}"
   th:text="'上次登录：' + ${#dates.format(user.lastLoginTime, 'yyyy-MM-dd HH:mm')}"></p>
<p th:unless="${user.lastLoginTime != null}">从未登录</p>

<!-- 使用Elvis运算符 -->
<p th:text="${user.lastLoginTime != null ? 
    #dates.format(user.lastLoginTime, 'yyyy-MM-dd') : '暂无数据'}"></p>
```

---

## 3. 🔢 数字格式化处理


### 3.1 基础数字格式化


**核心方法：formatDecimal**

```
语法：#numbers.formatDecimal(数值, 整数位最小长度, 小数位长度)
```

**实际应用**：

```html
<!-- 控制器传递：Double price = 12345.6789; -->

<!-- 1. 保留2位小数 -->
<p th:text="${#numbers.formatDecimal(price, 1, 2)}"></p>
<!-- 输出：12,345.68 -->

<!-- 2. 保留3位小数 -->
<p th:text="${#numbers.formatDecimal(price, 1, 3)}"></p>
<!-- 输出：12,345.679 -->

<!-- 3. 整数部分最少3位（不足补0） -->
<p th:text="${#numbers.formatDecimal(price, 3, 2)}"></p>
<!-- 输出：12,345.68 -->
```

### 3.2 千分位分隔符


**自动添加逗号分隔**：

```html
<!-- 大额数字展示 -->
<p>总销售额：<span th:text="${#numbers.formatDecimal(totalSales, 1, 2)}"></span> 元</p>
<!-- totalSales = 1234567.89 -->
<!-- 输出：总销售额：1,234,567.89 元 -->

<!-- 用户余额 -->
<p>账户余额：¥ <span th:text="${#numbers.formatDecimal(balance, 1, 2)}"></span></p>
<!-- balance = 98765.43 -->
<!-- 输出：账户余额：¥ 98,765.43 -->
```

### 3.3 整数格式化


**formatInteger方法**：

```html
<!-- 控制器：Integer count = 12345; -->

<!-- 1. 基础整数格式化 -->
<p th:text="${#numbers.formatInteger(count, 1)}"></p>
<!-- 输出：12,345 -->

<!-- 2. 指定最小位数 -->
<p th:text="${#numbers.formatInteger(count, 6)}"></p>
<!-- 输出：012,345 -->

<!-- 实际应用：商品库存 -->
<p>库存数量：<span th:text="${#numbers.formatInteger(stock, 1)}"></span> 件</p>
<!-- stock = 8888 -->
<!-- 输出：库存数量：8,888 件 -->
```

---

## 4. 💰 货币与百分比格式化


### 4.1 货币格式化


**方法一：手动添加货币符号**：

```html
<!-- 商品价格展示 -->
<p class="price">
    ¥ <span th:text="${#numbers.formatDecimal(product.price, 1, 2)}"></span>
</p>
<!-- product.price = 299.99 -->
<!-- 输出：¥ 299.99 -->

<!-- 订单总额 -->
<p>应付金额：
    <strong>¥<span th:text="${#numbers.formatDecimal(order.totalAmount, 1, 2)}"></span></strong>
</p>
<!-- order.totalAmount = 1588.50 -->
<!-- 输出：应付金额：¥1,588.50 -->
```

**方法二：使用formatCurrency**：

```html
<!-- 自动添加货币符号和格式 -->
<p th:text="${#numbers.formatCurrency(amount)}"></p>
<!-- amount = 12345.67 -->
<!-- 输出：¥12,345.67（根据系统语言环境） -->
```

### 4.2 百分比格式化


**基础百分比转换**：

```html
<!-- 控制器：Double rate = 0.856; -->

<!-- 1. 标准百分比格式（保留2位小数） -->
<p th:text="${#numbers.formatPercent(rate, 1, 2)}"></p>
<!-- 输出：85.60% -->

<!-- 2. 不保留小数 -->
<p th:text="${#numbers.formatPercent(rate, 1, 0)}"></p>
<!-- 输出：86% -->
```

**实际业务场景**：

```html
<!-- 商品折扣显示 -->
<span class="discount" th:text="${#numbers.formatPercent(discount, 1, 0)}"></span>
<!-- discount = 0.3 -->
<!-- 输出：30% -->

<!-- 考试成绩 -->
<p>正确率：<span th:text="${#numbers.formatPercent(correctRate, 1, 1)}"></span></p>
<!-- correctRate = 0.925 -->
<!-- 输出：正确率：92.5% -->

<!-- 完成进度 -->
<div class="progress-text" th:text="${#numbers.formatPercent(progress, 1, 0)}"></div>
<!-- progress = 0.68 -->
<!-- 输出：68% -->
```

### 4.3 货币格式对比展示


**原价与折扣价对比**：

```html
<div class="price-box">
    <!-- 原价（划线） -->
    <span class="original-price">
        原价：¥<del th:text="${#numbers.formatDecimal(originalPrice, 1, 2)}"></del>
    </span>
    
    <!-- 现价（突出显示） -->
    <span class="current-price">
        现价：¥<strong th:text="${#numbers.formatDecimal(currentPrice, 1, 2)}"></strong>
    </span>
    
    <!-- 折扣力度 -->
    <span class="discount-badge" th:text="${#numbers.formatPercent(discountRate, 1, 0)} + ' OFF'">
    </span>
</div>

<!-- 示例数据：
     originalPrice = 599
     currentPrice = 299
     discountRate = 0.5
-->
<!-- 输出：
     原价：¥599.00
     现价：¥299.00
     50% OFF
-->
```

---

## 5. 🛠️ 自定义格式化方案


### 5.1 创建自定义工具类


**Java端工具类**：

```java
// 自定义格式化工具类
@Component
public class CustomFormatter {
    
    /**
     * 格式化文件大小
     * @param bytes 字节数
     */
    public String formatFileSize(long bytes) {
        if (bytes < 1024) {
            return bytes + " B";
        } else if (bytes < 1024 * 1024) {
            return String.format("%.2f KB", bytes / 1024.0);
        } else if (bytes < 1024 * 1024 * 1024) {
            return String.format("%.2f MB", bytes / (1024.0 * 1024));
        } else {
            return String.format("%.2f GB", bytes / (1024.0 * 1024 * 1024));
        }
    }
    
    /**
     * 格式化手机号（隐藏中间4位）
     */
    public String formatPhone(String phone) {
        if (phone == null || phone.length() != 11) {
            return phone;
        }
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }
}
```

**在模板中使用**：

```html
<!-- 控制器注入工具类 -->
<!-- model.addAttribute("formatter", customFormatter); -->

<!-- 文件大小展示 -->
<p th:text="${formatter.formatFileSize(fileSize)}"></p>
<!-- fileSize = 2048576 -->
<!-- 输出：1.95 MB -->

<!-- 手机号脱敏 -->
<p th:text="${formatter.formatPhone(user.phone)}"></p>
<!-- user.phone = "13812345678" -->
<!-- 输出：138****5678 -->
```

### 5.2 扩展内置格式化


**工具类扩展示例**：

```java
@Component
public class AdvancedFormatter {
    
    /**
     * 格式化银行卡号（每4位空格）
     */
    public String formatBankCard(String cardNo) {
        return cardNo.replaceAll("(.{4})", "$1 ").trim();
    }
    
    /**
     * 格式化相对时间
     */
    public String formatRelativeTime(Date date) {
        long diff = System.currentTimeMillis() - date.getTime();
        long minutes = diff / (60 * 1000);
        
        if (minutes < 1) return "刚刚";
        if (minutes < 60) return minutes + "分钟前";
        
        long hours = minutes / 60;
        if (hours < 24) return hours + "小时前";
        
        long days = hours / 24;
        if (days < 30) return days + "天前";
        
        return new SimpleDateFormat("yyyy-MM-dd").format(date);
    }
}
```

**模板使用**：

```html
<!-- 银行卡号展示 -->
<p>卡号：<span th:text="${formatter.formatBankCard(bankCard)}"></span></p>
<!-- bankCard = "6222021234567890" -->
<!-- 输出：卡号：6222 0212 3456 7890 -->

<!-- 动态时间显示 -->
<p th:text="${formatter.formatRelativeTime(comment.createTime)}"></p>
<!-- 输出：3小时前 / 2天前 / 2025-09-20 -->
```

---

## 6. 🌏 时区与精度控制


### 6.1 时区处理


**指定时区格式化**：

```html
<!-- 1. 使用系统默认时区 -->
<p th:text="${#dates.format(createTime, 'yyyy-MM-dd HH:mm:ss')}"></p>

<!-- 2. 指定时区（如果需要） -->
<!-- Java端处理：
SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
sdf.setTimeZone(TimeZone.getTimeZone("Asia/Shanghai"));
-->
```

**常见时区场景**：

```html
<!-- 显示UTC时间 -->
<p>服务器时间（UTC）：
    <span th:text="${#dates.format(serverTime, 'yyyy-MM-dd HH:mm:ss')}"></span>
</p>

<!-- 显示本地时间 -->
<p>本地时间：
    <span th:text="${#dates.format(localTime, 'yyyy-MM-dd HH:mm:ss')}"></span>
</p>
```

### 6.2 数字精度控制


**小数位精度策略**：

```html
<!-- 1. 四舍五入（默认） -->
<p th:text="${#numbers.formatDecimal(3.1415926, 1, 2)}"></p>
<!-- 输出：3.14 -->

<!-- 2. 保留更多位数 -->
<p th:text="${#numbers.formatDecimal(3.1415926, 1, 4)}"></p>
<!-- 输出：3.1416 -->

<!-- 3. 科学计数法展示 -->
<!-- 需要Java端处理：
String.format("%.2e", value)
-->
```

**业务精度场景**：

```html
<!-- 金融计算（保留4位小数） -->
<p>汇率：<span th:text="${#numbers.formatDecimal(exchangeRate, 1, 4)}"></span></p>
<!-- exchangeRate = 6.8952 -->
<!-- 输出：汇率：6.8952 -->

<!-- 统计数据（保留1位小数） -->
<p>平均分：<span th:text="${#numbers.formatDecimal(avgScore, 1, 1)}"></span></p>
<!-- avgScore = 87.65 -->
<!-- 输出：平均分：87.7 -->
```

### 6.3 格式化精度对比


| 业务场景 | **小数位数** | **示例** |
|---------|------------|---------|
| `商品价格` | `2位` | `¥299.99` |
| `汇率计算` | `4-6位` | `6.8952` |
| `百分比` | `0-2位` | `85%` 或 `85.50%` |
| `统计数据` | `1-2位` | `87.7分` |
| `科学数据` | `按需求` | `3.14159` |

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的格式化方法


```
日期格式化：
🔸 #dates.format(date, 'yyyy-MM-dd') → 自定义格式
🔸 #dates.formatDate(date) → 快捷日期格式
🔸 #dates.formatTime(date) → 快捷时间格式

数字格式化：
🔸 #numbers.formatDecimal(num, 1, 2) → 小数格式
🔸 #numbers.formatInteger(num, 1) → 整数格式
🔸 #numbers.formatPercent(rate, 1, 2) → 百分比格式
🔸 #numbers.formatCurrency(amount) → 货币格式
```

### 7.2 实用格式化技巧


**日期格式化口诀**：
```
yyyy-MM-dd → 标准日期
HH:mm:ss → 24小时时间
yyyy年MM月dd日 → 中文日期
E → 星期几
```

**数字格式化口诀**：
```
formatDecimal(值, 整数最小位, 小数位) → 控制精度
第2个参数1 → 不补零
第3个参数2 → 保留2位小数
自动添加千分位逗号 → 增强可读性
```

### 7.3 常见应用场景总结


**电商系统**：
- ✅ 商品价格：`¥299.99`（2位小数）
- ✅ 折扣显示：`30% OFF`
- ✅ 订单时间：`2025-09-23 14:30`

**数据统计**：
- ✅ 增长率：`+15.8%`
- ✅ 平均值：`87.5分`
- ✅ 文件大小：`1.95 MB`

**用户信息**：
- ✅ 注册时间：`2025年9月`
- ✅ 手机号：`138****5678`
- ✅ 银行卡：`6222 0212 3456 7890`

### 7.4 最佳实践建议


**格式化原则**：
1. **一致性**：同类数据使用统一格式
2. **可读性**：优先考虑用户理解
3. **精度控制**：根据业务需求选择小数位
4. **空值处理**：避免null导致的异常
5. **国际化**：考虑不同地区的习惯

**性能优化**：
- 复杂格式化在Java端完成
- 简单格式化在模板端处理
- 避免在循环中重复格式化相同数据

**核心记忆**：
- 日期用 `#dates`，数字用 `#numbers`
- `format` 方法最灵活，快捷方法最方便
- 小数位控制在第3个参数
- 货币、百分比有专门方法
- 自定义需求用工具类扩展