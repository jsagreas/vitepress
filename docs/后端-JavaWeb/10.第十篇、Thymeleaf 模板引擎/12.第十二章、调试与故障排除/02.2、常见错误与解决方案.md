---
title: 2、常见错误与解决方案
---
## 📚 目录

1. [模板解析错误](#1-模板解析错误)
2. [表达式语法错误](#2-表达式语法错误)
3. [空指针异常](#3-空指针异常)
4. [类型转换错误](#4-类型转换错误)
5. [路径找不到错误](#5-路径找不到错误)
6. [编码问题](#6-编码问题)
7. [缓存问题](#7-缓存问题)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔧 模板解析错误


### 1.1 什么是模板解析错误


**通俗理解**：就像读一本书，如果书里有错别字、语法错误，你就读不懂。Thymeleaf解析模板时，如果模板文件写错了，它也"读不懂"，就会报错。

**专业定义**：模板解析错误是指Thymeleaf引擎在将HTML模板转换为可执行代码时，发现模板语法不符合规范而抛出的异常。

### 1.2 常见的模板解析错误类型


**🔸 标签未正确关闭**

错误示例：
```html
<!-- ❌ 错误：div标签没有关闭 -->
<div th:if="${user != null}">
    <p th:text="${user.name}"></p>
<!-- 缺少 </div> -->
```

正确写法：
```html
<!-- ✅ 正确：标签成对出现 -->
<div th:if="${user != null}">
    <p th:text="${user.name}"></p>
</div>
```

> 💡 **记住**：HTML标签就像括号，有开就要有闭，否则Thymeleaf会"糊涂"

**🔸 属性引号缺失或不匹配**

错误示例：
```html
<!-- ❌ 错误：引号没配对 -->
<p th:text="${user.name}></p>
<p th:text='${user.name}"></p>
```

正确写法：
```html
<!-- ✅ 正确：引号配对使用 -->
<p th:text="${user.name}"></p>
<p th:text='${user.name}'></p>
```

> ⚠️ **注意**：单引号和双引号不能混用，就像鞋子要穿一对

**🔸 Thymeleaf命名空间声明问题**

错误示例：
```html
<!-- ❌ 错误：忘记声明xmlns:th -->
<html>
<body>
    <p th:text="${message}"></p>
</body>
</html>
```

正确写法：
```html
<!-- ✅ 正确：在html标签声明命名空间 -->
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <p th:text="${message}"></p>
</body>
</html>
```

**为什么要声明？**
- 告诉Thymeleaf："这个页面里带`th:`的属性都是你的"
- 就像给快递写地址，让快递员知道往哪送

### 1.3 解决方案速查


| 错误表现 | 可能原因 | 解决方法 |
|---------|---------|---------|
| **标签解析失败** | `标签未闭合` | 检查所有标签是否成对 |
| **属性识别错误** | `引号不匹配` | 统一使用双引号或单引号 |
| **th:属性不生效** | `未声明命名空间` | 在html标签添加xmlns:th |
| **特殊字符报错** | `HTML实体未转义` | `&lt;` `&gt;` `&amp;` |

### 1.4 排查技巧


**步骤①**：查看IDE的语法高亮提示
```
如果代码颜色"不对劲"，通常就是语法有问题
```

**步骤②**：使用HTML验证工具
```
在线工具：W3C HTML Validator
本地工具：IDE自带的HTML检查
```

**步骤③**：逐行注释排查法
```html
<!-- 一行一行注释，找到出错的那一行 -->
<div th:if="${condition}">
    <!--<p th:text="${var1}"></p>-->
    <!--<p th:text="${var2}"></p>-->
    <p th:text="${var3}"></p>  <!-- 这行报错了！ -->
</div>
```

---

## 2. 📝 表达式语法错误


### 2.1 什么是表达式语法错误


**通俗理解**：就像数学题，`2 + 2 = ?` 是对的，但 `2 + + 2 = ?` 就错了。Thymeleaf的表达式也有自己的"语法规则"。

**专业定义**：表达式语法错误是指在 `${}` `*{}` `#{}` `@{}` `~{}` 等表达式中，写法不符合OGNL或SpringEL规范。

### 2.2 常见表达式错误


**🔸 变量表达式错误**

❌ 错误示例：
```html
<!-- 错误1：花括号没配对 -->
<p th:text="${user.name"></p>

<!-- 错误2：点号后面什么都没有 -->
<p th:text="${user.}"></p>

<!-- 错误3：多余的空格 -->
<p th:text="${ user.name }"></p>
```

✅ 正确写法：
```html
<p th:text="${user.name}"></p>
```

**🔸 选择表达式错误**

❌ 错误示例：
```html
<!-- 错误：*{} 必须在 th:object 内使用 -->
<p th:text="*{name}"></p>
```

✅ 正确写法：
```html
<div th:object="${user}">
    <p th:text="*{name}"></p>
</div>
```

**理解**：`*{name}` 就像说"它的名字"，但你得先说"它是谁"（th:object）

**🔸 链接表达式错误**

❌ 错误示例：
```html
<!-- 错误：参数拼接错误 -->
<a th:href="@{/user/} + ${userId}">链接</a>

<!-- 错误：参数语法错误 -->
<a th:href="@{/user/{id}(id:${userId})}">链接</a>
```

✅ 正确写法：
```html
<!-- 方式1：路径变量 -->
<a th:href="@{/user/{id}(id=${userId})}">链接</a>

<!-- 方式2：查询参数 -->
<a th:href="@{/user(id=${userId})}">链接</a>
```

生成结果对比：
```
方式1 → /user/123
方式2 → /user?id=123
```

### 2.3 表达式语法规则速记


**变量表达式 `${}`**
```
✅ ${user.name}          // 对象属性
✅ ${user['name']}       // 括号访问
✅ ${users[0].name}      // 数组/列表
✅ ${map.key}            // Map访问
❌ ${user .name}         // 不能有空格
❌ ${user..name}         // 不能连续点号
```

**选择表达式 `*{}`**
```
前提：必须在 th:object 范围内

<div th:object="${user}">
    ✅ *{name}           // 等价于 ${user.name}
    ✅ *{address.city}   // 等价于 ${user.address.city}
</div>
```

**链接表达式 `@{}`**
```
✅ @{/path}                    // 静态路径
✅ @{/user/{id}(id=${uid})}    // 路径变量
✅ @{/user(id=${uid})}         // 查询参数
✅ @{/user(id=${uid},name=${uname})}  // 多参数
```

### 2.4 调试技巧


**技巧①**：使用 `th:text` 输出调试
```html
<!-- 不确定表达式对不对？先输出看看 -->
<p th:text="${user}"></p>
<p th:text="${user.name}"></p>
```

**技巧②**：拆分复杂表达式
```html
<!-- ❌ 太复杂，容易出错 -->
<p th:text="${users[0].address.city + ', ' + users[0].address.country}"></p>

<!-- ✅ 拆分成多步 -->
<div th:with="addr=${users[0].address}">
    <p th:text="${addr.city + ', ' + addr.country}"></p>
</div>
```

---

## 3. ⚠️ 空指针异常


### 3.1 什么是空指针异常


**通俗理解**：就像你想打开一个盒子（对象），结果发现盒子根本不存在（null），当然打不开。

**专业定义**：NullPointerException，当程序试图访问一个值为null的对象的属性或方法时抛出的异常。

### 3.2 Thymeleaf中的空指针场景


**场景①：对象为null**

Controller传值：
```java
@GetMapping("/user")
public String user(Model model) {
    // 忘记添加user到model
    // model.addAttribute("user", null);  // 或者值是null
    return "user";
}
```

模板使用：
```html
<!-- ❌ 如果user是null，这里会报错 -->
<p th:text="${user.name}"></p>
```

错误信息：
```
Cannot invoke "com.example.User.getName()" because "user" is null
```

**场景②：属性为null**

Controller传值：
```java
User user = new User();
user.setName("张三");
// 没有设置address
model.addAttribute("user", user);
```

模板使用：
```html
<!-- ❌ address是null，访问city会报错 -->
<p th:text="${user.address.city}"></p>
```

**场景③：集合为null或空**

Controller传值：
```java
model.addAttribute("users", null);  // 或者是空集合
```

模板使用：
```html
<!-- ❌ users是null，获取第一个元素会报错 -->
<p th:text="${users[0].name}"></p>
```

### 3.3 解决方案


**方案①：Elvis运算符 `?:`（推荐）**

这是最简单的方式，就像问"有没有？没有就用这个"

```html
<!-- 如果user.name是null，就显示"未知" -->
<p th:text="${user.name} ?: '未知'"></p>

<!-- 多层级的安全访问 -->
<p th:text="${user.address?.city} ?: '未知城市'"></p>
```

**方案②：安全导航运算符 `?.`**

```html
<!-- 如果address是null，不会报错，而是返回null -->
<p th:text="${user.address?.city}"></p>

<!-- 配合Elvis运算符使用 -->
<p th:text="${user.address?.city} ?: '城市未知'"></p>
```

**方案③：条件判断**

```html
<!-- 先判断对象是否存在 -->
<div th:if="${user != null}">
    <p th:text="${user.name}"></p>
</div>

<!-- 判断多层级 -->
<div th:if="${user != null and user.address != null}">
    <p th:text="${user.address.city}"></p>
</div>
```

**方案④：设置默认值（后端处理）**

```java
@GetMapping("/user")
public String user(Model model) {
    User user = userService.findById(1);
    
    // 后端保证不为null
    if (user == null) {
        user = new User("默认用户");
    }
    
    model.addAttribute("user", user);
    return "user";
}
```

### 3.4 防空指针最佳实践


**规则清单**：

- [x] **后端传值前检查null**
- [x] **模板中使用 `?.` 安全导航**
- [x] **使用 `?:` 提供默认值**
- [x] **集合操作前先判断 `#lists.isEmpty()`**

**示例对比**：

```html
<!-- ❌ 危险写法 -->
<p th:text="${user.address.city}"></p>

<!-- ✅ 安全写法1：安全导航+默认值 -->
<p th:text="${user?.address?.city} ?: '未知'"></p>

<!-- ✅ 安全写法2：条件判断 -->
<p th:if="${user != null and user.address != null}" 
   th:text="${user.address.city}"></p>

<!-- ✅ 安全写法3：工具类方法 -->
<p th:text="${#objects.nullSafe(user?.address?.city, '未知')}"></p>
```

---

## 4. 🔄 类型转换错误


### 4.1 什么是类型转换错误


**通俗理解**：就像你想把"苹果"（字符串）当成数字用，程序会说"这不行啊"。

**专业定义**：当Thymeleaf试图将一个类型的数据转换为另一个类型，但转换失败时抛出的异常。

### 4.2 常见类型转换场景


**场景①：字符串转数字失败**

Controller传值：
```java
model.addAttribute("price", "abc");  // 字符串
```

模板使用：
```html
<!-- ❌ "abc"无法转成数字 -->
<p th:text="${price + 100}"></p>
```

错误信息：
```
Cannot convert value "abc" to type java.lang.Integer
```

**场景②：日期格式化错误**

Controller传值：
```java
model.addAttribute("date", "2024-01-01");  // 字符串
```

模板使用：
```html
<!-- ❌ 字符串不能直接格式化 -->
<p th:text="${#dates.format(date, 'yyyy-MM-dd')}"></p>
```

**场景③：布尔值判断错误**

```html
<!-- ❌ 数字不是布尔值 -->
<div th:if="${status}">  <!-- status是数字1，不是true/false -->
    内容
</div>
```

### 4.3 解决方案


**方案①：确保后端传递正确类型**

```java
// ✅ 正确：传递数字类型
model.addAttribute("price", 100);

// ✅ 正确：传递Date对象
model.addAttribute("date", new Date());

// ✅ 正确：传递布尔值
model.addAttribute("active", true);
```

**方案②：使用工具类转换**

数字转换：
```html
<!-- 字符串转数字 -->
<p th:with="num=${#numbers.parseInteger(str)}">
    计算结果：<span th:text="${num + 100}"></span>
</p>
```

日期转换：
```html
<!-- 字符串转日期（需要后端支持） -->
<p th:text="${#dates.format(#dates.create(dateStr, 'yyyy-MM-dd'), 'MM月dd日')}"></p>
```

**方案③：类型检查后再使用**

```html
<!-- 先判断类型，再操作 -->
<div th:if="${#numbers.isNumber(value)}">
    <p th:text="${value + 100}"></p>
</div>

<div th:unless="${#numbers.isNumber(value)}">
    <p>数据格式错误</p>
</div>
```

### 4.4 类型转换对照表


| 场景 | 错误写法 | 正确写法 |
|-----|---------|---------|
| **字符串拼接** | `${num + str}` | `${num + ''} + ${str}` |
| **数字计算** | `${str + 100}` | `${#numbers.parseInteger(str) + 100}` |
| **日期格式化** | `${#dates.format(str)}` | 后端传Date对象 |
| **布尔判断** | `th:if="${1}"` | `th:if="${flag == true}"` |

---

## 5. 📁 路径找不到错误


### 5.1 什么是路径找不到错误


**通俗理解**：就像导航找地址，地址写错了，当然找不到。Thymeleaf也要"找"文件，路径错了就找不到。

**专业定义**：模板文件、静态资源或片段的路径配置错误，导致Thymeleaf无法定位到目标文件。

### 5.2 常见路径错误


**错误①：模板路径错误**

目录结构：
```
src/main/resources/
  └── templates/
      └── user/
          └── info.html
```

Controller返回：
```java
// ❌ 错误：路径不对
return "userInfo";        // 找不到
return "/user/info";      // 多了斜杠
return "user/info.html";  // 多了后缀
```

正确写法：
```java
// ✅ 正确
return "user/info";
```

**错误②：片段引用路径错误**

目录结构：
```
templates/
  ├── common/
  │   └── header.html
  └── user/
      └── info.html
```

在 `user/info.html` 中引用：
```html
<!-- ❌ 错误写法 -->
<div th:insert="header :: head"></div>
<div th:insert="/common/header :: head"></div>

<!-- ✅ 正确写法 -->
<div th:insert="~{common/header :: head}"></div>
```

**错误③：静态资源路径错误**

目录结构：
```
src/main/resources/
  └── static/
      ├── css/
      │   └── style.css
      └── images/
          └── logo.png
```

模板中引用：
```html
<!-- ❌ 错误：多了static -->
<link th:href="@{/static/css/style.css}" />

<!-- ❌ 错误：路径写反了 -->
<img th:src="@{/logo.png}" />

<!-- ✅ 正确：从static目录开始 -->
<link th:href="@{/css/style.css}" />
<img th:src="@{/images/logo.png}" />
```

### 5.3 路径规则详解


**模板路径规则**：
```
默认路径：classpath:/templates/
文件扩展名：.html（可省略）

示例：
目录：templates/user/list.html
返回值：user/list
```

**片段路径规则**：
```
语法：~{模板路径 :: 片段名}

同目录：~{header :: head}
子目录：~{common/footer :: foot}
父目录：~{../layout :: main}
```

**静态资源路径规则**：
```
默认路径：classpath:/static/

CSS/JS：@{/css/style.css}  @{/js/app.js}
图片：@{/images/logo.png}
字体：@{/fonts/custom.ttf}
```

### 5.4 路径问题排查步骤


**步骤①**：检查目录结构
```bash
# 使用IDE查看项目结构
src/main/resources/
  ├── templates/    # 模板文件在这
  └── static/       # 静态文件在这
```

**步骤②**：验证配置
```yaml
# application.yml
spring:
  thymeleaf:
    prefix: classpath:/templates/  # 模板前缀
    suffix: .html                   # 文件后缀
```

**步骤③**：测试路径
```java
// 在Controller里打印日志
@GetMapping("/test")
public String test() {
    System.out.println("返回模板路径：user/info");
    return "user/info";
}
```

**步骤④**：查看错误日志
```
错误信息通常会明确指出找不到的文件路径
Error resolving template "user/info", 
template might not exist or might not be accessible
```

### 5.5 路径最佳实践


建议清单：

- [x] **统一使用相对路径**
- [x] **不要写文件扩展名（.html）**
- [x] **不要在路径前加斜杠**
- [x] **静态资源用 `@{}` 包裹**

示例对照：
```html
<!-- ✅ 推荐写法 -->
返回模板：return "user/info";
引用片段：~{common/header :: nav}
引用CSS：@{/css/style.css}
引用图片：@{/images/logo.png}

<!-- ❌ 不推荐 -->
返回模板：return "/user/info.html";
引用片段：common/header :: nav
引用CSS：/static/css/style.css
引用图片：../images/logo.png
```

---

## 6. 🔤 编码问题


### 6.1 什么是编码问题


**通俗理解**：就像普通话和方言，如果你说的"话"（编码）和别人听的"话"不一样，就会出现乱码。

**专业定义**：字符编码不一致导致的中文或特殊字符显示异常，常见为UTF-8与其他编码冲突。

### 6.2 常见编码问题


**问题①：页面显示乱码**

表现：
```
期望：你好世界
实际：浣犲ソ涓栫晫  或  ???
```

原因：
```
HTML文件编码 ≠ 浏览器解析编码
```

**问题②：Controller传值乱码**

Controller代码：
```java
model.addAttribute("msg", "你好");  // 中文
```

页面显示：
```html
<p th:text="${msg}"></p>
<!-- 显示：??? 或乱码 -->
```

**问题③：表单提交乱码**

表单：
```html
<form th:action="@{/save}" method="post">
    <input type="text" name="username" value="张三" />
</form>
```

Controller接收：
```java
// 接收到：å¼ ä¸‰  （乱码）
```

### 6.3 解决方案


**方案①：统一文件编码（最重要）**

IDEA设置：
```
File → Settings → Editor → File Encodings
├─ Global Encoding: UTF-8
├─ Project Encoding: UTF-8
└─ Default encoding for properties files: UTF-8
```

HTML文件头部：
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- ✅ 必须添加，告诉浏览器用UTF-8解析 -->
    <meta charset="UTF-8">
</head>
```

**方案②：配置Spring Boot编码**

```yaml
# application.yml
spring:
  thymeleaf:
    encoding: UTF-8           # 模板编码
    
  http:
    encoding:
      charset: UTF-8          # HTTP响应编码
      enabled: true
      force: true
```

**方案③：配置过滤器（POST请求）**

```java
@Bean
public FilterRegistrationBean<CharacterEncodingFilter> encodingFilter() {
    CharacterEncodingFilter filter = new CharacterEncodingFilter();
    filter.setEncoding("UTF-8");
    filter.setForceEncoding(true);
    
    FilterRegistrationBean<CharacterEncodingFilter> registration = 
        new FilterRegistrationBean<>(filter);
    registration.addUrlPatterns("/*");
    return registration;
}
```

**方案④：数据库编码配置**

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/db?characterEncoding=utf8&useUnicode=true
```

### 6.4 编码问题检查清单


**逐项检查**：

**① IDEA项目编码**
```
Settings → Editor → File Encodings
全部设置为 UTF-8
```

**② HTML文件编码**
```html
<meta charset="UTF-8">  <!-- 必须有 -->
```

**③ application.yml配置**
```yaml
spring.thymeleaf.encoding: UTF-8
```

**④ 数据库连接编码**
```
characterEncoding=utf8
```

**⑤ Tomcat配置（如果用外部Tomcat）**
```xml
<Connector URIEncoding="UTF-8" />
```

### 6.5 快速诊断方法


**测试步骤**：

步骤①：创建测试页面
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <p>中文测试：你好世界</p>
    <p th:text="'动态中文：' + ${msg}"></p>
</body>
</html>
```

步骤②：Controller传中文
```java
@GetMapping("/test")
public String test(Model model) {
    model.addAttribute("msg", "你好");
    return "test";
}
```

步骤③：检查浏览器
```
F12 → Network → Headers → Content-Type
应该看到：text/html;charset=UTF-8
```

---

## 7. 🔄 缓存问题


### 7.1 什么是缓存问题


**通俗理解**：就像你改了作业，但老师看的还是旧版本，因为老师记住了之前的答案（缓存）。

**专业定义**：Thymeleaf为提高性能会缓存模板，修改后不会立即生效，需要重启或禁用缓存。

### 7.2 缓存问题表现


**问题①：修改模板不生效**

现象：
```
1. 修改了 user.html
2. 刷新浏览器
3. 页面还是旧的内容
4. 需要重启项目才能看到新内容
```

**问题②：开发效率低**

痛点：
```
改一次代码 → 重启项目 → 等待启动 → 刷新页面
太慢了！
```

**问题③：生产环境需要缓存**

矛盾：
```
开发环境：不要缓存，改了立即看到
生产环境：要缓存，提高性能
```

### 7.3 解决方案


**方案①：开发环境禁用缓存（推荐）**

```yaml
# application-dev.yml（开发环境配置）
spring:
  thymeleaf:
    cache: false  # 关闭缓存
```

**方案②：区分环境配置**

目录结构：
```
src/main/resources/
  ├── application.yml           # 公共配置
  ├── application-dev.yml       # 开发环境
  └── application-prod.yml      # 生产环境
```

application.yml：
```yaml
spring:
  profiles:
    active: dev  # 激活开发环境
```

application-dev.yml：
```yaml
spring:
  thymeleaf:
    cache: false  # 开发不缓存
```

application-prod.yml：
```yaml
spring:
  thymeleaf:
    cache: true   # 生产要缓存
```

**方案③：使用DevTools自动重启**

添加依赖：
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <optional>true</optional>
</dependency>
```

效果：
```
修改文件 → 自动重启 → 立即生效
（比手动重启快很多）
```

**方案④：IDEA配置自动编译**

设置步骤：
```
1. Settings → Build → Compiler
   ✅ 勾选 Build project automatically

2. Settings → Advanced Settings
   ✅ 勾选 Allow auto-make to start even if...

3. 修改文件后，按 Ctrl+F9 编译
```

### 7.4 缓存配置详解


**完整配置项**：

```yaml
spring:
  thymeleaf:
    cache: false                # 是否缓存模板（开发false，生产true）
    check-template: true        # 检查模板是否存在
    check-template-location: true  # 检查模板位置
    
  devtools:
    restart:
      enabled: true             # 启用自动重启
      additional-paths: src/main/java  # 监控Java文件
    livereload:
      enabled: true             # 启用浏览器自动刷新
```

### 7.5 开发环境最佳实践


**推荐配置组合**：

application-dev.yml：
```yaml
spring:
  thymeleaf:
    cache: false               # ✅ 关键：禁用缓存
    prefix: classpath:/templates/
    suffix: .html
    encoding: UTF-8
    mode: HTML
    
  devtools:
    restart:
      enabled: true            # ✅ 开启自动重启
      
server:
  port: 8080
```

IDEA设置：
```
✅ 自动编译
✅ 保存时编译
✅ DevTools开启
```

效果：
```
修改模板 → 自动编译 → 自动重启 → 立即看到效果
（整个过程2-3秒）
```

### 7.6 缓存问题排查


**检查清单**：

**① 确认配置生效**
```java
// 在Controller打印配置
@Value("${spring.thymeleaf.cache}")
private boolean cacheEnabled;

System.out.println("缓存状态：" + cacheEnabled);
// 开发环境应该输出：false
```

**② 检查配置文件**
```yaml
# 确保dev配置被激活
spring:
  profiles:
    active: dev  # ✅ 是dev不是prod
```

**③ 清除IDEA缓存**
```
File → Invalidate Caches → Invalidate and Restart
```

**④ 确认DevTools生效**
```
启动日志应该有：
Devtools property defaults active! 
```

---

## 8. 📋 核心要点总结


### 8.1 七大常见错误速查表


| 错误类型 | 典型表现 | 第一反应 | 解决关键 |
|---------|---------|---------|---------|
| **🔧 模板解析错误** | `标签、引号错误` | 检查HTML语法 | 标签成对、引号配对 |
| **📝 表达式语法错误** | `${}、*{}写错` | 检查表达式语法 | 参考官方规则 |
| **⚠️ 空指针异常** | `null访问报错` | 使用安全导航 | `?.` 和 `?:` |
| **🔄 类型转换错误** | `类型不匹配` | 检查数据类型 | 后端传对类型 |
| **📁 路径找不到** | `文件找不到` | 检查路径规则 | 相对路径、无后缀 |
| **🔤 编码问题** | `中文乱码` | 统一UTF-8 | 所有地方UTF-8 |
| **🔄 缓存问题** | `改了不生效` | 禁用缓存 | dev环境cache=false |

### 8.2 必须掌握的调试技巧


**🔸 技巧①：分步调试法**
```html
<!-- 复杂表达式拆开写 -->
<div th:with="user=${users[0]}, addr=${user.address}">
    <p th:text="${addr.city}"></p>
</div>
```

**🔸 技巧②：输出调试法**
```html
<!-- 不确定值是什么，先输出看看 -->
<p th:text="'调试：' + ${variable}"></p>
```

**🔸 技巧③：条件保护法**
```html
<!-- 不确定是否为null，先判断 -->
<div th:if="${obj != null}">
    <p th:text="${obj.property}"></p>
</div>
```

**🔸 技巧④：日志辅助法**
```java
// Controller里打印日志
log.info("传递数据：{}", user);
```

### 8.3 开发环境配置检查清单


**环境配置**：
- [x] IDEA编码设置UTF-8
- [x] HTML文件charset=UTF-8
- [x] application-dev.yml缓存关闭
- [x] DevTools依赖已添加
- [x] 自动编译已开启

**代码规范**：
- [x] 模板文件在templates目录
- [x] 静态资源在static目录
- [x] 路径不带后缀、不带斜杠
- [x] 空值使用`?.`和`?:`保护
- [x] 类型在后端确保正确

### 8.4 生产环境注意事项


**上线前检查**：

```yaml
# ✅ 生产环境必须开启缓存
spring:
  thymeleaf:
    cache: true

# ✅ 关闭DevTools
spring:
  devtools:
    restart:
      enabled: false
```

**性能优化**：
```
✅ 模板缓存开启
✅ 静态资源使用CDN
✅ 压缩HTML输出
✅ 设置合理的超时时间
```

**错误处理**：
```java
// ✅ 配置全局错误页面
@ControllerAdvice
public class ErrorHandler {
    @ExceptionHandler(TemplateInputException.class)
    public String handleTemplateError() {
        return "error/template-error";
    }
}
```

### 8.5 故障排查流程图


```
发现错误
    ↓
查看错误信息（控制台/浏览器F12）
    ↓
确定错误类型
    ├─ 解析错误 → 检查HTML语法
    ├─ 表达式错误 → 检查${}语法
    ├─ 空指针 → 添加?:保护
    ├─ 类型错误 → 检查数据类型
    ├─ 路径错误 → 检查文件位置
    ├─ 编码错误 → 检查UTF-8配置
    └─ 缓存错误 → 禁用缓存
    ↓
解决后测试验证
    ↓
记录经验，避免重复犯错
```

---

**🎯 核心记忆口诀**：

> **标签成对引号配，表达式中花括号带**  
> **空值保护问号加，类型正确不用怕**  
> **路径规则要记牢,编码统一UTF-8**  
> **开发缓存要关掉，生产缓存不能少**

---

**💡 最后建议**：

遇到错误不要慌，按照以下步骤来：

**第一步**：看错误信息，定位问题
**第二步**：对照本笔记，找解决方案  
**第三步**：动手修改，测试验证
**第四步**：记录经验，下次不犯

记住：**90%的错误都是这7类，掌握它们，Thymeleaf开发无忧！** 🚀