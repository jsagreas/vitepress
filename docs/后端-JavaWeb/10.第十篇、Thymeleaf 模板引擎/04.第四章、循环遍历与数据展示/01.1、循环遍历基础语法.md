---
title: 1、循环遍历基础语法
---
## 📚 目录

1. [循环遍历是什么](#1-循环遍历是什么)
2. [th:each核心语法](#2-theach核心语法)
3. [遍历不同数据类型](#3-遍历不同数据类型)
4. [循环状态变量](#4-循环状态变量)
5. [嵌套循环实战](#5-嵌套循环实战)
6. [空集合处理技巧](#6-空集合处理技巧)
7. [循环变量作用域](#7-循环变量作用域)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 循环遍历是什么


### 1.1 为什么需要循环遍历


**生活中的类比**：
```
想象你是班主任，要在黑板上写出全班同学的名字：
- 传统方式：一个个手写 → 张三、李四、王五...（累死了）
- 循环方式：拿着花名册，按顺序抄写（轻松多了）

Thymeleaf循环遍历就是这个道理！
```

**实际开发场景**：
```
电商网站商品列表：
后端传来 100 个商品数据 → 前端要显示 100 个商品卡片
- 不用循环：写100遍HTML（疯了）
- 用循环：写1次模板，自动生成100个（优雅）
```

### 1.2 循环遍历的本质


**核心理解**：
- **循环**：重复执行相同的操作
- **遍历**：依次访问集合中的每个元素
- **模板复用**：一个HTML片段，生成多份内容

**工作原理图示**：
```
后端数据 List<User>           Thymeleaf模板                  最终HTML
┌─────────────┐              ┌──────────────┐              ┌──────────────┐
│ [0] 张三     │              │ <div>        │              │ <div>张三</div>│
│ [1] 李四     │  ========>   │   {name}     │  ========>   │ <div>李四</div>│
│ [2] 王五     │              │ </div>       │              │ <div>王五</div>│
└─────────────┘              └──────────────┘              └──────────────┘
    数据源                      单个模板                      重复生成
```

---

## 2. 📝 th:each核心语法


### 2.1 基础语法结构


**语法格式**：
```html
th:each="临时变量 : ${集合数据}"
```

**语法拆解理解**：
- `th:each` ➡️ Thymeleaf的循环指令
- `临时变量` ➡️ 每次循环时，当前元素的名字（你自己起）
- `:` ➡️ 分隔符（固定写法）
- `${集合数据}` ➡️ 从后端获取的数据集合

**最简单示例**：
```html
<!-- 后端：List<String> names = ["张三", "李四", "王五"] -->

<ul>
    <li th:each="name : ${names}" th:text="${name}"></li>
</ul>

<!-- 生成结果 -->
<ul>
    <li>张三</li>
    <li>李四</li>
    <li>王五</li>
</ul>
```

### 2.2 完整语法（带状态变量）


**扩展语法**：
```html
th:each="临时变量, 状态变量 : ${集合数据}"
```

**状态变量是什么**：
- 系统自动提供的辅助信息
- 告诉你当前循环到第几个、是不是第一个/最后一个等

**示例对比**：
```html
<!-- 基础版：只有数据 -->
<div th:each="user : ${users}">
    <span th:text="${user.name}"></span>
</div>

<!-- 完整版：数据 + 状态 -->
<div th:each="user, stat : ${users}">
    <span>第 <span th:text="${stat.index}"></span> 个用户：</span>
    <span th:text="${user.name}"></span>
</div>
```

---

## 3. 🔄 遍历不同数据类型


### 3.1 List集合遍历（最常用）


**实际场景**：用户列表、商品列表、订单列表

```java
// 后端Controller
@GetMapping("/users")
public String userList(Model model) {
    List<User> users = Arrays.asList(
        new User(1, "张三", 25),
        new User(2, "李四", 30),
        new User(3, "王五", 28)
    );
    model.addAttribute("users", users);
    return "userList";
}
```

```html
<!-- 前端模板：用户卡片列表 -->
<div class="user-list">
    <div class="user-card" th:each="user : ${users}">
        <h3 th:text="${user.name}">姓名</h3>
        <p>年龄：<span th:text="${user.age}">0</span></p>
    </div>
</div>

<!-- 生成结果 -->
<div class="user-list">
    <div class="user-card">
        <h3>张三</h3>
        <p>年龄：<span>25</span></p>
    </div>
    <div class="user-card">
        <h3>李四</h3>
        <p>年龄：<span>30</span></p>
    </div>
    <div class="user-card">
        <h3>王五</h3>
        <p>年龄：<span>28</span></p>
    </div>
</div>
```

### 3.2 数组遍历


**和List的区别**：数组是固定长度的，List可以动态增删

```java
// 后端：传递数组
String[] colors = {"红色", "绿色", "蓝色"};
model.addAttribute("colors", colors);
```

```html
<!-- 前端：遍历数组 -->
<select>
    <option th:each="color : ${colors}" 
            th:value="${color}" 
            th:text="${color}">
    </option>
</select>

<!-- 生成的下拉框 -->
<select>
    <option value="红色">红色</option>
    <option value="绿色">绿色</option>
    <option value="蓝色">蓝色</option>
</select>
```

### 3.3 Map遍历（键值对）


**Map是什么**：存储"key-value"对应关系的数据结构

```java
// 后端：学生成绩表
Map<String, Integer> scores = new HashMap<>();
scores.put("张三", 95);
scores.put("李四", 88);
scores.put("王五", 92);
model.addAttribute("scores", scores);
```

```html
<!-- 方式1：使用entry遍历 -->
<table>
    <tr th:each="entry : ${scores}">
        <td th:text="${entry.key}">学生</td>
        <td th:text="${entry.value}">分数</td>
    </tr>
</table>

<!-- 方式2：直接获取key和value -->
<table>
    <tr th:each="student, score : ${scores}">
        <td th:text="${student}">学生</td>
        <td th:text="${score}">分数</td>
    </tr>
</table>

<!-- 生成表格 -->
<table>
    <tr>
        <td>张三</td>
        <td>95</td>
    </tr>
    <tr>
        <td>李四</td>
        <td>88</td>
    </tr>
    <tr>
        <td>王五</td>
        <td>92</td>
    </tr>
</table>
```

### 3.4 数字范围遍历


**应用场景**：生成固定数量的元素、分页按钮

```html
<!-- 遍历1到5 -->
<button th:each="num : ${#numbers.sequence(1, 5)}" 
        th:text="${num}">
</button>

<!-- 生成5个按钮 -->
<button>1</button>
<button>2</button>
<button>3</button>
<button>4</button>
<button>5</button>

<!-- 实用案例：分页按钮 -->
<div class="pagination">
    <a th:each="page : ${#numbers.sequence(1, totalPages)}" 
       th:href="@{/list(page=${page})}"
       th:text="${page}">
    </a>
</div>
```

---

## 4. 📊 循环状态变量


### 4.1 状态变量是什么


**简单理解**：循环过程中的"实时信息板"

```
想象你在操场跑圈：
- index：当前是第几圈（从0开始数）
- count：当前是第几圈（从1开始数）
- first：是不是第一圈
- last：是不是最后一圈
- even/odd：是奇数圈还是偶数圈
```

### 4.2 状态变量详解


| 属性名 | 含义 | 数值示例 | 应用场景 |
|--------|------|----------|----------|
| **index** | 当前索引（从0开始） | 0, 1, 2, 3... | 数组下标、序号计算 |
| **count** | 当前计数（从1开始） | 1, 2, 3, 4... | 显示序号 |
| **size** | 集合总元素数 | 10 | 显示总数 |
| **first** | 是否第一个 | true/false | 第一行特殊样式 |
| **last** | 是否最后一个 | true/false | 最后一行特殊处理 |
| **even** | 是否偶数位 | true/false | 斑马纹表格 |
| **odd** | 是否奇数位 | true/false | 斑马纹表格 |

### 4.3 实战应用示例


**场景1：显示序号**
```html
<table>
    <tr th:each="user, stat : ${users}">
        <td th:text="${stat.count}">序号</td>
        <td th:text="${user.name}">姓名</td>
    </tr>
</table>

<!-- 生成 -->
<tr><td>1</td><td>张三</td></tr>
<tr><td>2</td><td>李四</td></tr>
<tr><td>3</td><td>王五</td></tr>
```

**场景2：斑马纹表格（隔行变色）**
```html
<table>
    <tr th:each="item, stat : ${items}"
        th:class="${stat.odd} ? 'row-odd' : 'row-even'">
        <td th:text="${item.name}"></td>
    </tr>
</table>

<!-- CSS样式 -->
<style>
    .row-odd { background: #f0f0f0; }
    .row-even { background: #ffffff; }
</style>
```

**场景3：首尾特殊处理**
```html
<ul>
    <li th:each="item, stat : ${items}">
        <!-- 第一个加标签 -->
        <span th:if="${stat.first}" class="badge">最新</span>
        <span th:text="${item.title}"></span>
        <!-- 最后一个不加分隔符 -->
        <span th:unless="${stat.last}">|</span>
    </li>
</ul>
```

---

## 5. 🔗 嵌套循环实战


### 5.1 什么时候用嵌套循环


**生活场景**：
```
学校 → 年级 → 班级 → 学生
├─ 一年级
│  ├─ 一班：张三、李四
│  └─ 二班：王五、赵六
└─ 二年级
   ├─ 一班：孙七、周八
   └─ 二班：吴九、郑十
```

**数据结构**：外层是年级，内层是学生

### 5.2 基础嵌套示例


```java
// 后端：班级数据
class ClassRoom {
    String name;
    List<String> students;
}

List<ClassRoom> classes = Arrays.asList(
    new ClassRoom("一班", Arrays.asList("张三", "李四")),
    new ClassRoom("二班", Arrays.asList("王五", "赵六"))
);
```

```html
<!-- 外层循环：班级 -->
<div th:each="classRoom : ${classes}">
    <h3 th:text="${classRoom.name}">班级</h3>
    
    <!-- 内层循环：学生 -->
    <ul>
        <li th:each="student : ${classRoom.students}" 
            th:text="${student}">
        </li>
    </ul>
</div>

<!-- 生成结果 -->
<div>
    <h3>一班</h3>
    <ul>
        <li>张三</li>
        <li>李四</li>
    </ul>
</div>
<div>
    <h3>二班</h3>
    <ul>
        <li>王五</li>
        <li>赵六</li>
    </ul>
</div>
```

### 5.3 表格嵌套示例


**场景**：商品分类展示

```html
<table>
    <!-- 外层：分类 -->
    <tbody th:each="category : ${categories}">
        <!-- 分类标题行 -->
        <tr class="category-header">
            <td th:text="${category.name}" colspan="3"></td>
        </tr>
        <!-- 内层：该分类下的商品 -->
        <tr th:each="product : ${category.products}">
            <td th:text="${product.name}">商品名</td>
            <td th:text="${product.price}">价格</td>
        </tr>
    </tbody>
</table>
```

### 5.4 嵌套循环的状态变量


```html
<!-- 使用外层和内层的状态变量 -->
<div th:each="grade, gradeStat : ${grades}">
    <h2>第<span th:text="${gradeStat.count}"></span>年级</h2>
    
    <ul>
        <li th:each="student, stuStat : ${grade.students}">
            年级第<span th:text="${gradeStat.count}"></span>位，
            班级第<span th:text="${stuStat.count}"></span>位：
            <span th:text="${student.name}"></span>
        </li>
    </ul>
</div>
```

---

## 6. 🛡️ 空集合处理技巧


### 6.1 为什么要处理空集合


**问题场景**：
```
用户搜索商品，但没有搜到任何结果
- 不处理：页面空白（用户懵了）
- 优雅处理：显示"暂无商品"（用户明白了）
```

### 6.2 方法1：使用 th:if 判断


```html
<!-- 先判断集合是否为空 -->
<div th:if="${users != null and !users.isEmpty()}">
    <div th:each="user : ${users}">
        <span th:text="${user.name}"></span>
    </div>
</div>

<!-- 空集合时显示提示 -->
<div th:if="${users == null or users.isEmpty()}">
    <p>暂无用户数据</p>
</div>
```

### 6.3 方法2：使用 th:unless（推荐）


```html
<!-- 有数据时显示列表 -->
<ul th:unless="${#lists.isEmpty(users)}">
    <li th:each="user : ${users}" th:text="${user.name}"></li>
</ul>

<!-- 无数据时显示提示 -->
<div th:if="${#lists.isEmpty(users)}" class="empty-tip">
    <p>😊 还没有用户，快去添加吧！</p>
</div>
```

### 6.4 方法3：Elvis运算符（默认值）


```html
<!-- 集合为空时使用默认空列表 -->
<ul>
    <li th:each="item : ${items ?: {}}" 
        th:text="${item.name}">
    </li>
</ul>

<!-- 如果items为null，?: {}提供一个空集合，避免报错 -->
```

### 6.5 完整空数据处理方案


```html
<!-- 商品列表完整示例 -->
<div class="product-container">
    <!-- 有商品时 -->
    <div th:if="${!#lists.isEmpty(products)}">
        <div class="product-grid">
            <div class="product-card" th:each="product : ${products}">
                <h3 th:text="${product.name}">商品名</h3>
                <p th:text="${product.price}">价格</p>
            </div>
        </div>
        <p class="total">共 <span th:text="${#lists.size(products)}"></span> 件商品</p>
    </div>
    
    <!-- 无商品时 -->
    <div th:if="${#lists.isEmpty(products)}" class="empty-state">
        <img src="/images/empty-cart.png" alt="空空如也">
        <p>暂无商品，看看其他分类吧~</p>
        <a href="/categories">浏览分类</a>
    </div>
</div>
```

---

## 7. 🎯 循环变量作用域


### 7.1 作用域是什么


**通俗理解**：变量的"活动范围"

```
班级里的规则：
- 班长（全班都认识）→ 全局变量
- 组长（只在小组内认识）→ 循环变量
```

### 7.2 循环变量的作用范围


```html
<!-- 循环变量只在当前标签及子标签内有效 -->
<div th:each="user : ${users}">
    <!-- ✅ 这里可以用 user -->
    <span th:text="${user.name}"></span>
    
    <div>
        <!-- ✅ 子标签内也可以用 -->
        <p th:text="${user.age}"></p>
    </div>
</div>

<!-- ❌ 这里不能用 user，已经超出作用域 -->
<p th:text="${user.name}">错误！</p>
```

### 7.3 变量覆盖问题


```html
<!-- 外层循环 -->
<div th:each="user : ${users}">
    <h3 th:text="${user.name}">用户名</h3>
    
    <!-- ⚠️ 内层循环也叫user，会覆盖外层的user -->
    <ul th:each="user : ${user.friends}">
        <li th:text="${user}">朋友</li>
    </ul>
    
    <!-- ❌ 这里的user已经是内层的了 -->
    <p th:text="${user.name}">无法显示外层用户名</p>
</div>
```

**正确写法**：
```html
<!-- 使用不同的变量名 -->
<div th:each="user : ${users}">
    <h3 th:text="${user.name}">用户名</h3>
    
    <!-- ✅ 内层用不同的变量名 -->
    <ul>
        <li th:each="friend : ${user.friends}" 
            th:text="${friend}">
        </li>
    </ul>
    
    <!-- ✅ 外层user不受影响 -->
    <p th:text="${user.name}">可以正常显示</p>
</div>
```

### 7.4 状态变量的作用域


```html
<div th:each="user, userStat : ${users}">
    <!-- userStat只在这个div内有效 -->
    <span th:text="${userStat.count}">序号</span>
    
    <div th:each="order, orderStat : ${user.orders}">
        <!-- 两个状态变量可以共存 -->
        <p>用户序号：<span th:text="${userStat.count}"></span></p>
        <p>订单序号：<span th:text="${orderStat.count}"></span></p>
    </div>
</div>
```

### 7.5 作用域最佳实践


**✅ 推荐做法**：
```html
<!-- 1. 使用有意义的变量名 -->
<div th:each="product : ${products}">
    <div th:each="review : ${product.reviews}">
        <!-- 清晰明了 -->
    </div>
</div>

<!-- 2. 避免变量名冲突 -->
<div th:each="user : ${users}">
    <div th:each="friend : ${user.friends}">
        <!-- 不用user，用friend -->
    </div>
</div>
```

**❌ 不推荐做法**：
```html
<!-- 1. 使用无意义的变量名 -->
<div th:each="x : ${products}">
    <div th:each="y : ${x.reviews}">
        <!-- 看不懂x和y是什么 -->
    </div>
</div>

<!-- 2. 变量名重复使用 -->
<div th:each="item : ${items}">
    <div th:each="item : ${item.children}">
        <!-- 容易出错 -->
    </div>
</div>
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 循环遍历本质：一个模板，重复生成多份内容
🔸 th:each语法：th:each="临时变量 : ${集合数据}"
🔸 状态变量：index、count、first、last、even、odd
🔸 空集合处理：使用th:if或th:unless判断
🔸 作用域规则：循环变量只在当前标签及子标签内有效
```

### 8.2 常用数据类型遍历


| 数据类型 | 后端示例 | 前端遍历 | 应用场景 |
|---------|---------|---------|---------|
| **List** | `List<User>` | `th:each="user : ${users}"` | 用户列表、商品列表 |
| **数组** | `String[]` | `th:each="item : ${array}"` | 下拉框选项 |
| **Map** | `Map<K,V>` | `th:each="entry : ${map}"` | 键值对数据 |
| **数字** | - | `th:each="i : ${#numbers.sequence(1,5)}"` | 分页按钮 |

### 8.3 实战开发技巧


**🎯 技巧1：合理使用状态变量**
```html
<!-- ✅ 显示序号用count -->
<span th:text="${stat.count}"></span>

<!-- ✅ 斑马纹用odd/even -->
<tr th:class="${stat.odd ? 'odd-row' : 'even-row'}">

<!-- ✅ 首尾特殊处理用first/last -->
<div th:class="${stat.first ? 'first-item' : ''}">
```

**🎯 技巧2：空数据友好提示**
```html
<!-- 有数据显示列表，无数据显示提示 -->
<div th:if="${!#lists.isEmpty(items)}">
    <!-- 列表内容 -->
</div>
<div th:if="${#lists.isEmpty(items)}">
    <p>暂无数据</p>
</div>
```

**🎯 技巧3：嵌套循环变量命名**
```html
<!-- 使用有意义的变量名，避免冲突 -->
<div th:each="category : ${categories}">
    <div th:each="product : ${category.products}">
        <!-- 清晰明了 -->
    </div>
</div>
```

### 8.4 常见问题速查


**❓ 为什么循环没有执行？**
- 检查集合是否为null
- 检查集合是否为空
- 检查变量名是否正确

**❓ 为什么变量获取不到值？**
- 检查是否在作用域内
- 检查变量名是否被覆盖
- 检查对象属性是否存在

**❓ 如何显示"第X个"？**
- 使用 `${stat.count}` （从1开始）
- 或使用 `${stat.index + 1}` （index从0开始）

**❓ 如何实现隔行变色？**
- 使用 `${stat.odd}` 和 `${stat.even}`
- 配合CSS类实现样式切换

### 8.5 学习路线建议


```
入门阶段（掌握基础）：
├─ ① 理解循环遍历的作用
├─ ② 掌握th:each基本语法
├─ ③ 学会遍历List和数组
└─ ④ 了解状态变量的使用

进阶阶段（灵活运用）：
├─ ① Map遍历和嵌套循环
├─ ② 空集合优雅处理
├─ ③ 作用域和变量管理
└─ ④ 结合条件判断使用

实战阶段（综合应用）：
├─ ① 商品列表页面
├─ ② 数据表格展示
├─ ③ 分类导航菜单
└─ ④ 评论列表展示
```

**核心记忆口诀**：
- 循环遍历th:each，一份模板生成多个
- 临时变量冒号前，后接集合用大括号
- 状态变量逗号隔，序号首尾都能查
- 空集合要判断，友好提示不可少
- 作用域要注意，变量命名别冲突