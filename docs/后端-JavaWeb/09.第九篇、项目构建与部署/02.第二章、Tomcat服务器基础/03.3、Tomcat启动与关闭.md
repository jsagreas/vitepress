---
title: 3、Tomcat启动与关闭
---
## 📚 目录

1. [Tomcat启动方式概览](#1-Tomcat启动方式概览)
2. [Windows环境启动与关闭](#2-Windows环境启动与关闭)
3. [Linux环境启动与关闭](#3-Linux环境启动与关闭)
4. [catalina.sh运行模式详解](#4-catalina运行模式详解)
5. [Windows服务方式安装](#5-Windows服务方式安装)
6. [Linux服务配置](#6-Linux服务配置)
7. [启动参数配置优化](#7-启动参数配置优化)
8. [常见问题与解决方案](#8-常见问题与解决方案)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🚀 Tomcat启动方式概览


### 1.1 什么是Tomcat启动


**🔸 简单理解**
想象Tomcat就像一个**餐厅服务员**，它需要"上班"才能为客户(浏览器)提供服务(网页)。启动Tomcat就是让这个"服务员上班"的过程。

**🔸 启动的本质含义**
```
启动前：Tomcat程序在硬盘里"睡觉"
启动后：Tomcat程序在内存中"工作"，监听端口等待请求
```

### 1.2 启动方式分类


| 启动方式 | **适用环境** | **使用场景** | **特点** |
|---------|------------|-------------|---------|
| 🔸 **脚本启动** | `开发/测试` | `临时使用，手动控制` | `简单直接，适合学习` |
| 🔸 **服务方式** | `生产环境` | `自动启动，后台运行` | `稳定可靠，便于管理` |
| 🔸 **IDE集成** | `开发环境` | `代码调试，热部署` | `开发便捷，实时调试` |

### 1.3 启动文件作用说明


**🔹 核心启动文件**
```
📁 Tomcat安装目录/bin/
├── startup.sh/startup.bat     ← 启动脚本(简化版)
├── shutdown.sh/shutdown.bat   ← 关闭脚本(简化版) 
├── catalina.sh/catalina.bat   ← 核心控制脚本(完整版)
└── setenv.sh/setenv.bat       ← 环境变量配置(可选)
```

> 💡 **理解要点**  
> `startup.sh`就像电视遥控器的"开机键"，而`catalina.sh`就像电视机的完整控制面板，功能更全面。

---

## 2. 🖥️ Windows环境启动与关闭


### 2.1 使用startup.bat启动


**🔸 基本启动步骤**
```
第1步：打开命令提示符(cmd)
第2步：切换到Tomcat的bin目录
第3步：执行启动命令
```

**🔹 具体操作演示**
```cmd
# 切换到Tomcat目录(假设安装在C盘)
cd C:\apache-tomcat-9.0.65\bin

# 执行启动脚本
startup.bat
```

**🔸 启动成功标志**
```
启动后会弹出新的命令行窗口，显示：
- "Server startup in xxx ms" ← 启动完成
- 浏览器访问 http://localhost:8080 看到Tomcat猫页面
```

### 2.2 使用shutdown.bat关闭


**🔹 正常关闭方式**
```cmd
# 在bin目录执行
shutdown.bat
```

**🔹 强制关闭方式**
```
方法1：直接关闭Tomcat的命令行窗口
方法2：任务管理器结束java.exe进程
```

> ⚠️ **重要提醒**  
> 尽量用`shutdown.bat`正常关闭，强制关闭可能导致数据丢失或文件损坏。

### 2.3 Windows启动问题排查


**🔸 常见错误及解决**

**问题1：提示"JAVA_HOME未设置"**
```cmd
# 解决方案：设置环境变量
set JAVA_HOME=C:\Program Files\Java\jdk1.8.0_333
set PATH=%JAVA_HOME%\bin;%PATH%
```

**问题2：端口被占用**
```
错误信息：Port 8080 already in use
解决方案：
1. 找到占用进程：netstat -ano | findstr :8080
2. 结束进程：taskkill /F /PID 进程号
3. 或修改Tomcat端口号
```

---

## 3. 🐧 Linux环境启动与关闭


### 3.1 使用startup.sh启动


**🔸 基本启动流程**
```bash
# 切换到Tomcat目录
cd /opt/apache-tomcat-9.0.65/bin

# 给脚本执行权限(首次运行)
chmod +x *.sh

# 启动Tomcat
./startup.sh
```

**🔹 后台启动方式**
```bash
# 后台启动并输出日志到文件
nohup ./startup.sh > /dev/null 2>&1 &

# 或者直接后台启动
./startup.sh &
```

### 3.2 使用shutdown.sh关闭


**🔹 正常关闭**
```bash
# 正常关闭
./shutdown.sh

# 等待10秒强制关闭
./shutdown.sh 10
```

**🔹 强制关闭方式**
```bash
# 查找Tomcat进程
ps -ef | grep tomcat

# 强制结束进程
kill -9 进程号

# 或者一键结束所有java进程(慎用)
pkill -f tomcat
```

### 3.3 Linux启动权限处理


**🔸 权限问题解决**
```bash
# 如果提示权限不足
sudo chown -R 用户名:用户名 /opt/apache-tomcat-9.0.65/
chmod 755 /opt/apache-tomcat-9.0.65/bin/*.sh
```

**🔸 防火墙配置**
```bash
# CentOS/RHEL 开放8080端口
firewall-cmd --zone=public --add-port=8080/tcp --permanent
firewall-cmd --reload

# Ubuntu 开放8080端口  
ufw allow 8080
```

---

## 4. ⚙️ catalina运行模式详解


### 4.1 什么是catalina.sh


**🔸 通俗理解**
如果说`startup.sh`是"一键开机"，那么`catalina.sh`就是"高级控制台"，提供更多运行选项和控制功能。

**🔸 两者关系**
```
startup.sh脚本内容实际上是：
exec "$PRGDIR"/"$EXECUTABLE" start "$@"
其中$EXECUTABLE就是catalina.sh
```

### 4.2 catalina运行模式


**🔹 常用运行模式**

```bash
# 1. 前台启动模式(调试用)
./catalina.sh run

# 2. 后台启动模式  
./catalina.sh start

# 3. 调试模式启动
./catalina.sh jpda start

# 4. 停止服务
./catalina.sh stop
```

**🔸 模式对比说明**

| 模式 | **特点** | **使用场景** | **日志输出** |
|------|---------|-------------|-------------|
| `run` | `前台运行，Ctrl+C可停止` | `开发调试` | `直接显示在终端` |
| `start` | `后台运行，需要stop停止` | `生产部署` | `输出到日志文件` |
| `jpda start` | `调试模式，可远程调试` | `代码调试` | `输出到日志文件` |

### 4.3 调试模式详解


**🔸 启用远程调试**
```bash
# 启动调试模式
export JPDA_ADDRESS=8000
export JPDA_TRANSPORT=dt_socket
./catalina.sh jpda start
```

**🔸 调试参数说明**
```
JPDA_ADDRESS=8000    ← 调试端口号
JPDA_TRANSPORT=dt_socket  ← 调试传输方式
JPDA_SUSPEND=n       ← 是否等待调试器连接(n=不等待)
```

> 💡 **实用技巧**  
> 开发时用`catalina.sh run`能直接看到错误信息，生产环境用`catalina.sh start`更稳定。

---

## 5. 🔧 Windows服务方式安装


### 5.1 什么是Windows服务


**🔸 通俗类比**
Windows服务就像**保安值班**，系统启动时自动上岗，用户注销也不下班，一直在后台默默工作。

**🔸 服务方式的优势**
- ✅ **开机自启**：电脑一开机Tomcat就自动运行
- ✅ **后台运行**：不占用桌面，无需保持命令行窗口
- ✅ **权限隔离**：以系统权限运行，更安全
- ✅ **便于管理**：通过服务管理器统一管理

### 5.2 安装Tomcat为Windows服务


**🔸 方法一：使用service.bat安装**
```cmd
# 切换到bin目录
cd C:\apache-tomcat-9.0.65\bin

# 安装服务
service.bat install

# 卸载服务
service.bat remove
```

**🔸 方法二：使用Tomcat安装版**
```
下载Tomcat Windows Service Installer版本(.exe文件)
安装过程中自动注册为Windows服务
```

### 5.3 Windows服务管理


**🔹 启动和停止服务**
```cmd
# 命令行方式
net start Tomcat9        # 启动服务
net stop Tomcat9         # 停止服务

# 或通过服务管理器
Win+R → services.msc → 找到Apache Tomcat服务
```

**🔹 服务配置调整**
```
服务管理器中可配置：
- 启动类型：自动/手动/禁用
- 登录账户：本地系统/指定用户  
- 恢复选项：失败后重启策略
```

### 5.4 服务方式的参数配置


**🔸 修改服务参数**
```
通过tomcatXw.exe程序(X为版本号)调整：
- JVM参数：内存大小、垃圾收集器等
- 启动参数：端口号、配置文件路径等
- 日志设置：日志级别、输出位置等
```

**🔹 内存参数示例**
```
-Xms512m          # 初始内存512MB
-Xmx1024m         # 最大内存1GB  
-XX:PermSize=256m # 永久代内存(JDK8以下)
```

---

## 6. 🐧 Linux服务配置


### 6.1 创建systemd服务


**🔸 什么是systemd服务**
systemd是Linux系统的"大管家"，负责管理所有系统服务。把Tomcat注册为systemd服务，就像给它办了个"正式工作证"。

**🔸 创建服务文件**
```bash
# 创建服务文件
sudo vim /etc/systemd/system/tomcat.service
```

**🔹 服务文件内容**
```ini
[Unit]
Description=Apache Tomcat 9
After=network.target

[Service]
Type=forking
User=tomcat
Group=tomcat
Environment="JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64"
Environment="CATALINA_HOME=/opt/apache-tomcat-9.0.65"
Environment="CATALINA_BASE=/opt/apache-tomcat-9.0.65"
ExecStart=/opt/apache-tomcat-9.0.65/bin/startup.sh
ExecStop=/opt/apache-tomcat-9.0.65/bin/shutdown.sh
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### 6.2 服务文件配置说明


**🔸 关键参数含义**
```
[Unit]部分：
Description  ← 服务描述信息  
After        ← 在网络启动后再启动

[Service]部分：
Type=forking    ← 服务类型(后台进程)
User/Group      ← 运行用户和组
Environment     ← 环境变量设置
ExecStart       ← 启动命令
ExecStop        ← 停止命令  
Restart=always  ← 崩溃后自动重启

[Install]部分：
WantedBy        ← 服务启动级别
```

### 6.3 服务管理命令


**🔹 基本管理操作**
```bash
# 重载systemd配置
sudo systemctl daemon-reload

# 启动服务
sudo systemctl start tomcat

# 停止服务
sudo systemctl stop tomcat

# 重启服务
sudo systemctl restart tomcat

# 查看服务状态
sudo systemctl status tomcat
```

**🔹 开机自启设置**
```bash
# 设置开机自启
sudo systemctl enable tomcat

# 取消开机自启
sudo systemctl disable tomcat

# 查看自启状态
sudo systemctl is-enabled tomcat
```

### 6.4 用户权限配置


**🔸 创建专用用户**
```bash
# 创建tomcat用户组
sudo groupadd tomcat

# 创建tomcat用户(不能登录)
sudo useradd -M -s /bin/nologin -g tomcat -d /opt/apache-tomcat-9.0.65 tomcat

# 设置目录权限
sudo chown -R tomcat:tomcat /opt/apache-tomcat-9.0.65
```

**🔸 权限设置说明**
```
为什么要创建专用用户？
1. 安全性：限制Tomcat的系统权限
2. 隔离性：与其他服务分离运行  
3. 管理性：便于权限管理和审计
```

---

## 7. 🎛️ 启动参数配置优化


### 7.1 JVM内存参数调优


**🔸 内存参数含义**
```
想象JVM就像一个工厂：
-Xms ← 工厂初始大小(启动时分配的内存)
-Xmx ← 工厂最大规模(最多能用的内存)  
-Xss ← 每个工人的工位大小(线程栈空间)
```

**🔹 常用内存配置**
```bash
# 在setenv.sh中设置(Linux)
export CATALINA_OPTS="$CATALINA_OPTS -Xms1024m"    # 初始内存1GB
export CATALINA_OPTS="$CATALINA_OPTS -Xmx2048m"    # 最大内存2GB
export CATALINA_OPTS="$CATALINA_OPTS -Xss512k"     # 线程栈512KB

# Windows在setenv.bat中设置
set CATALINA_OPTS=%CATALINA_OPTS% -Xms1024m -Xmx2048m
```

### 7.2 垃圾收集器参数


**🔸 垃圾收集器类比**
垃圾收集器就像**清洁工**，定期清理内存中不用的对象。不同的清洁工有不同的工作方式：

```
串行GC ← 一个清洁工慢慢清理(适合小应用)
并行GC ← 多个清洁工一起清理(适合大应用)  
G1GC  ← 智能清洁工，边工作边清理(适合低延迟要求)
```

**🔹 GC参数配置**
```bash
# G1垃圾收集器(推荐)
export CATALINA_OPTS="$CATALINA_OPTS -XX:+UseG1GC"
export CATALINA_OPTS="$CATALINA_OPTS -XX:MaxGCPauseMillis=200"

# 并行GC
export CATALINA_OPTS="$CATALINA_OPTS -XX:+UseParallelGC"
```

### 7.3 网络和连接参数


**🔸 连接相关参数**
```bash
# 文件编码
export CATALINA_OPTS="$CATALINA_OPTS -Dfile.encoding=UTF-8"

# 网络超时设置  
export CATALINA_OPTS="$CATALINA_OPTS -Dsun.net.client.defaultConnectTimeout=60000"

# HTTP连接池大小
export CATALINA_OPTS="$CATALINA_OPTS -Dhttp.maxConnections=200"
```

### 7.4 参数配置文件位置


**🔸 配置文件优先级**
```
配置参数的加载顺序(后面的覆盖前面的)：
1. catalina.sh中的默认设置
2. setenv.sh中的用户设置  ← 推荐在这里配置
3. 启动命令行参数
4. 环境变量CATALINA_OPTS
```

**🔹 setenv.sh示例文件**
```bash
#!/bin/bash
# Tomcat启动参数配置

# JVM内存设置
export CATALINA_OPTS="$CATALINA_OPTS -Xms1024m -Xmx2048m"

# 垃圾收集器
export CATALINA_OPTS="$CATALINA_OPTS -XX:+UseG1GC"

# 字符编码
export CATALINA_OPTS="$CATALINA_OPTS -Dfile.encoding=UTF-8"

# JMX监控(可选)
export CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote"
export CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote.port=9999"
export CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote.authenticate=false"
export CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote.ssl=false"
```

---

## 8. 🔧 常见问题与解决方案


### 8.1 启动失败问题


**🔸 问题1：端口占用**
```
错误信息：Address already in use: JVM_Bind
解决方案：
1. 查找占用进程：netstat -tlnp | grep :8080
2. 结束占用进程：kill -9 进程ID
3. 或修改server.xml中的端口号
```

**🔸 问题2：内存不足**
```
错误信息：OutOfMemoryError: Java heap space
解决方案：
增加JVM内存：-Xmx2048m
检查内存泄漏：使用内存分析工具
```

**🔸 问题3：权限问题**
```
错误信息：Permission denied
解决方案：
chmod +x bin/*.sh                    # 给执行权限
chown -R tomcat:tomcat /opt/tomcat   # 设置所有者
```

### 8.2 性能相关问题


**🔸 启动速度慢**
```
原因分析：
- JVM预热时间长
- 应用初始化耗时
- 资源加载过多

优化方案：
1. 调整JVM参数：-XX:+TieredCompilation
2. 减少不必要的jar包
3. 优化应用代码逻辑
```

**🔸 内存使用过高**
```
排查步骤：
1. 监控内存使用：jstat -gc PID 1s
2. 分析内存堆栈：jmap -dump PID
3. 使用分析工具：MAT、VisualVM等

常见原因：
- 静态集合未清理
- 数据库连接未关闭  
- 缓存数据过多
```

### 8.3 日志问题排查


**🔸 找不到日志文件**
```
日志文件位置：
- catalina.out        ← 主要日志文件
- logs/catalina.日期   ← 按日期分割的日志
- logs/localhost.日期  ← 本地访问日志
- logs/manager.日期    ← 管理器日志
```

**🔸 日志级别调整**
```xml
<!-- 在conf/logging.properties中修改 -->
# 全局日志级别
.level = INFO

# Tomcat内部日志
org.apache.catalina.core.ContainerBase.[Catalina].level = INFO

# 应用日志
org.apache.catalina.core.ContainerBase.[Catalina].[localhost].level = INFO
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的基本概念


**🔸 启动方式选择**
```
📝 开发阶段：脚本启动(startup.sh/bat)
📝 测试阶段：catalina.sh run(便于调试)  
📝 生产阶段：服务方式启动(稳定可靠)
```

**🔸 关键文件作用**
```
startup.sh/bat   ← 简化启动脚本，新手首选
catalina.sh/bat  ← 完整控制脚本，功能全面  
shutdown.sh/bat  ← 正常关闭脚本，避免数据丢失
setenv.sh/bat    ← 参数配置文件，调优必备
```

### 9.2 实践操作要点


**🔹 Windows环境核心操作**
1. 确保JAVA_HOME环境变量正确设置
2. 使用startup.bat启动，shutdown.bat关闭
3. 生产环境建议安装为Windows服务
4. 在setenv.bat中配置JVM参数

**🔹 Linux环境核心操作**  
1. 给shell脚本添加执行权限：`chmod +x *.sh`
2. 创建专用tomcat用户运行服务
3. 配置systemd服务实现开机自启
4. 在setenv.sh中配置启动参数

### 9.3 参数调优要点


**🔸 内存配置原则**
```
开发环境：-Xms512m -Xmx1024m     (够用即可)
测试环境：-Xms1024m -Xmx2048m    (接近生产)  
生产环境：-Xms2048m -Xmx4096m    (根据实际需求)

原则：Xms和Xmx设为相同值，避免内存动态分配开销
```

**🔸 常用优化参数**
```bash
# 基础内存配置
-Xms2048m -Xmx2048m

# 垃圾收集器  
-XX:+UseG1GC -XX:MaxGCPauseMillis=200

# 字符编码
-Dfile.encoding=UTF-8

# 网络优化
-Djava.net.preferIPv4Stack=true
```

### 9.4 故障排查思路


**🔸 启动失败排查顺序**
```
第1步：检查Java环境 → java -version
第2步：检查端口占用 → netstat检查8080端口
第3步：查看错误日志 → catalina.out文件
第4步：检查配置文件 → server.xml语法
第5步：验证权限设置 → 文件和目录权限
```

**🔸 性能问题排查**
```
监控工具：
- jps       ← 查看Java进程
- jstat     ← 查看JVM统计信息
- jmap      ← 生成内存dump文件  
- jstack    ← 查看线程堆栈
- VisualVM  ← 可视化监控工具
```

> 🎯 **学习建议**  
> 新手应该先掌握脚本启动方式，熟练后再学习服务安装和参数调优。实际项目中建议使用服务方式，更稳定可靠。

**核心记忆要点**：
- 开发用脚本，生产用服务
- 正常关闭避免数据丢失  
- 内存参数影响性能表现
- 日志文件是排错利器