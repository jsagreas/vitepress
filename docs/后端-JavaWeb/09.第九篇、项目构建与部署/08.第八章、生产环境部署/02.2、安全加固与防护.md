---
title: 2ã€å®‰å…¨åŠ å›ºä¸é˜²æŠ¤
---
## ğŸ“š ç›®å½•

1. [å®‰å…¨åŠ å›ºåŸºç¡€æ¦‚å¿µ](#1-å®‰å…¨åŠ å›ºåŸºç¡€æ¦‚å¿µ)
2. [åˆ é™¤é»˜è®¤åº”ç”¨](#2-åˆ é™¤é»˜è®¤åº”ç”¨)
3. [ç¦ç”¨ç®¡ç†ç•Œé¢](#3-ç¦ç”¨ç®¡ç†ç•Œé¢)
4. [ç”¨æˆ·æƒé™æ§åˆ¶](#4-ç”¨æˆ·æƒé™æ§åˆ¶)
5. [é˜²æ­¢ç›®å½•éå†æ”»å‡»](#5-é˜²æ­¢ç›®å½•éå†æ”»å‡»)
6. [éšè—ç‰ˆæœ¬ä¿¡æ¯](#6-éšè—ç‰ˆæœ¬ä¿¡æ¯)
7. [è®¿é—®æ§åˆ¶é…ç½®](#7-è®¿é—®æ§åˆ¶é…ç½®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ å®‰å…¨åŠ å›ºåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å®‰å…¨åŠ å›º


**ç®€å•ç†è§£**ï¼šå°±åƒç»™ä½ çš„æˆ¿å­è£…é˜²ç›—é—¨ã€æ‘„åƒå¤´ä¸€æ ·ï¼Œç»™JavaWebåº”ç”¨åŠ ä¸Šå„ç§å®‰å…¨æªæ–½ã€‚

```
ğŸ  æˆ¿å­å®‰å…¨ vs ğŸ–¥ï¸ JavaWebå®‰å…¨ï¼š

æˆ¿å­ä¿æŠ¤æªæ–½ï¼š              JavaWebä¿æŠ¤æªæ–½ï¼š
é˜²ç›—é—¨ â†â†’ ç”¨æˆ·æƒé™æ§åˆ¶
æ‘„åƒå¤´ â†â†’ è®¿é—®æ—¥å¿—ç›‘æ§
çª—æˆ·é” â†â†’ ç«¯å£è®¿é—®æ§åˆ¶
ä¸å±•ç¤ºè´¢äº§ â†â†’ éšè—ç‰ˆæœ¬ä¿¡æ¯
åˆ é™¤å¤šä½™é’¥åŒ™ â†â†’ åˆ é™¤é»˜è®¤åº”ç”¨
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨åŠ å›º


**ğŸ¯ ç°å®åœºæ™¯ç±»æ¯”**ï¼š
```
æƒ³è±¡ä½ å¼€äº†ä¸€å®¶ç½‘åº—ï¼š
âŒ ä¸å®‰å…¨çš„åšæ³•ï¼š
â€¢ åº—é—¨24å°æ—¶å¼€ç€ï¼ˆç®¡ç†ç•Œé¢æš´éœ²ï¼‰
â€¢ æŠŠä»“åº“é’¥åŒ™ç»™æ‰€æœ‰äººï¼ˆæƒé™è¿‡å¤§ï¼‰
â€¢ åœ¨é—¨å£è´´ç€"æˆ‘ç”¨XXç³»ç»Ÿ"ï¼ˆæš´éœ²ç‰ˆæœ¬ä¿¡æ¯ï¼‰
â€¢ åº—é‡Œå †æ»¡äº†ä¸ç”¨çš„ä¸œè¥¿ï¼ˆé»˜è®¤åº”ç”¨æœªåˆ é™¤ï¼‰

âœ… å®‰å…¨çš„åšæ³•ï¼š
â€¢ è¥ä¸šæ—¶é—´æ‰å¼€é—¨ï¼ˆæŒ‰éœ€å¼€æ”¾æœåŠ¡ï¼‰
â€¢ ä¸åŒå‘˜å·¥ä¸åŒæƒé™ï¼ˆæœ€å°æƒé™åŸåˆ™ï¼‰
â€¢ ä¸æš´éœ²å†…éƒ¨ä¿¡æ¯ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰
â€¢ å®šæœŸæ¸…ç†æ— ç”¨ç‰©å“ï¼ˆåˆ é™¤ä¸å¿…è¦ç»„ä»¶ï¼‰
```

### 1.3 å®‰å…¨åŠ å›ºçš„åŸºæœ¬åŸåˆ™


**ğŸ” æ ¸å¿ƒå®‰å…¨åŸåˆ™**ï¼š
```
æœ€å°æƒé™åŸåˆ™ï¼š
åªç»™ç”¨æˆ·å®Œæˆå·¥ä½œæ‰€éœ€çš„æœ€å°æƒé™
ç±»æ¯”ï¼šé“¶è¡Œå‡ºçº³å‘˜åªèƒ½æ“ä½œç°é‡‘ï¼Œä¸èƒ½è®¿é—®é‡‘åº“

çºµæ·±é˜²å¾¡ï¼š
å»ºç«‹å¤šå±‚é˜²æŠ¤ï¼Œä¸ä¾èµ–å•ä¸€å®‰å…¨æªæ–½
ç±»æ¯”ï¼šåŸå ¡æœ‰å¤–å¢™ã€å†…å¢™ã€æŠ¤åŸæ²³å¤šå±‚é˜²æŠ¤

é»˜è®¤æ‹’ç»ï¼š
é»˜è®¤æƒ…å†µä¸‹æ‹’ç»è®¿é—®ï¼Œæ˜ç¡®å…è®¸æ‰é€šè¿‡
ç±»æ¯”ï¼šå°åŒºé—¨ç¦ï¼Œä¸æ˜¯ä¸šä¸»å°±è¿›ä¸æ¥

å®šæœŸç»´æŠ¤ï¼š
å®‰å…¨ä¸æ˜¯ä¸€åŠ³æ°¸é€¸ï¼Œéœ€è¦æŒç»­å…³æ³¨
ç±»æ¯”ï¼šæ±½è½¦éœ€è¦å®šæœŸä¿å…»æ£€æŸ¥
```

**âš ï¸ å¸¸è§å®‰å…¨é£é™©**ï¼š

| é£é™©ç±»å‹ | **å…·ä½“è¡¨ç°** | **å¯èƒ½åæœ** | **é˜²æŠ¤æ–¹æ³•** |
|----------|-------------|-------------|-------------|
| ğŸšª **é»˜è®¤é…ç½®** | `ä½¿ç”¨å‡ºå‚è®¾ç½®` | `è¢«è½»æ˜“å…¥ä¾µ` | `ä¿®æ”¹é»˜è®¤å€¼` |
| ğŸ‘¤ **æƒé™è¿‡å¤§** | `æ‰€æœ‰ç”¨æˆ·éƒ½æ˜¯ç®¡ç†å‘˜` | `å†…éƒ¨æ•°æ®æ³„éœ²` | `æœ€å°æƒé™åˆ†é…` |
| ğŸ“‚ **ä¿¡æ¯æ³„éœ²** | `æ˜¾ç¤ºç³»ç»Ÿç‰ˆæœ¬` | `é’ˆå¯¹æ€§æ”»å‡»` | `éšè—æ•æ„Ÿä¿¡æ¯` |
| ğŸ—‚ï¸ **ç›®å½•éå†** | `å¯è®¿é—®ç³»ç»Ÿæ–‡ä»¶` | `æœåŠ¡å™¨è¢«æ§åˆ¶` | `è·¯å¾„è®¿é—®é™åˆ¶` |

---

## 2. ğŸ—‘ï¸ åˆ é™¤é»˜è®¤åº”ç”¨


### 2.1 ä¸ºä»€ä¹ˆè¦åˆ é™¤é»˜è®¤åº”ç”¨


**ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒä¹°äº†æ–°æ‰‹æœºè¦åˆ æ‰ä¸ç”¨çš„é¢„è£…è½¯ä»¶ä¸€æ ·ï¼

```
ğŸ¯ é—®é¢˜åˆ†æï¼š
æ–°è£…çš„Tomcatå°±åƒåˆšä¹°çš„æ‰‹æœºï¼š
â€¢ é¢„è£…äº†å¾ˆå¤š"æ¼”ç¤ºåº”ç”¨"
â€¢ è¿™äº›åº”ç”¨ä½ ç”¨ä¸åˆ°ï¼Œä½†é»‘å®¢å¯èƒ½åˆ©ç”¨
â€¢ å ç”¨èµ„æºï¼Œå¢åŠ æ”»å‡»é¢
â€¢ å¯èƒ½åŒ…å«å·²çŸ¥å®‰å…¨æ¼æ´

è§£å†³æ–¹æ¡ˆï¼š
å°±åƒåˆ é™¤æ‰‹æœºé‡Œä¸ç”¨çš„APP
æŠŠæœåŠ¡å™¨é‡Œä¸ç”¨çš„åº”ç”¨ä¹Ÿåˆ æ‰
```

### 2.2 è¯†åˆ«é»˜è®¤åº”ç”¨


**ğŸ“± Tomcaté»˜è®¤åº”ç”¨æ¸…å•**ï¼š
```
Tomcatå®‰è£…åè‡ªå¸¦çš„"æ¼”ç¤ºåº”ç”¨"ï¼š
webapps/
â”œâ”€â”€ ROOT/           â† æ¬¢è¿é¡µé¢ï¼ˆæ˜¾ç¤ºTomcatç‰ˆæœ¬ï¼‰
â”œâ”€â”€ docs/           â† æ–‡æ¡£åº”ç”¨ï¼ˆåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
â”œâ”€â”€ examples/       â† ç¤ºä¾‹åº”ç”¨ï¼ˆå¯èƒ½æœ‰æ¼æ´ï¼‰
â”œâ”€â”€ host-manager/   â† è™šæ‹Ÿä¸»æœºç®¡ç†
â””â”€â”€ manager/        â† Webç®¡ç†ç•Œé¢

å±é™©æ€§è¯„ä¼°ï¼š
ğŸ”´ é«˜å±ï¼šmanagerã€host-managerï¼ˆç®¡ç†æƒé™ï¼‰
ğŸŸ¡ ä¸­å±ï¼šexamplesï¼ˆç¤ºä¾‹ä»£ç æ¼æ´ï¼‰
ğŸŸ¡ ä¸­å±ï¼šROOTã€docsï¼ˆä¿¡æ¯æ³„éœ²ï¼‰
```

### 2.3 å®‰å…¨åˆ é™¤æ–¹æ³•


**ğŸ› ï¸ åˆ é™¤æ­¥éª¤**ï¼š

**ç¬¬ä¸€æ­¥ï¼šå¤‡ä»½é‡è¦æ–‡ä»¶**
```bash
# åœæ­¢TomcatæœåŠ¡
sudo systemctl stop tomcat

# å¤‡ä»½é…ç½®æ–‡ä»¶ï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰
cp -r /opt/tomcat/conf /opt/tomcat/conf.backup
```

**ç¬¬äºŒæ­¥ï¼šåˆ é™¤é»˜è®¤åº”ç”¨**
```bash
# è¿›å…¥webappsç›®å½•
cd /opt/tomcat/webapps

# åˆ é™¤ä¸éœ€è¦çš„é»˜è®¤åº”ç”¨
sudo rm -rf ROOT docs examples host-manager

# åªä¿ç•™ä½ çš„åº”ç”¨å’Œå¿…è¦çš„managerï¼ˆå¦‚æœéœ€è¦ï¼‰
ls -la  # æ£€æŸ¥åˆ é™¤ç»“æœ
```

**ç¬¬ä¸‰æ­¥ï¼šè‡ªå®šä¹‰ROOTåº”ç”¨**
```bash
# åˆ›å»ºæ–°çš„ROOTç›®å½•
sudo mkdir ROOT

# åˆ›å»ºç®€å•çš„é¦–é¡µï¼Œä¸æš´éœ²ç³»ç»Ÿä¿¡æ¯
cat > ROOT/index.html << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <title>Service Available</title>
</head>
<body>
    <h1>æœåŠ¡æ­£å¸¸è¿è¡Œ</h1>
    <p>ç³»ç»ŸçŠ¶æ€ï¼šæ­£å¸¸</p>
</body>
</html>
EOF
```

**ğŸ” åˆ é™¤æ•ˆæœéªŒè¯**ï¼š
```
åˆ é™¤å‰è®¿é—®ï¼š
http://yourserver:8080/          # æ˜¾ç¤ºTomcatç‰ˆæœ¬ä¿¡æ¯
http://yourserver:8080/docs/     # æ˜¾ç¤ºå®Œæ•´æ–‡æ¡£
http://yourserver:8080/examples/ # æ˜¾ç¤ºç¤ºä¾‹åº”ç”¨

åˆ é™¤åè®¿é—®ï¼š
http://yourserver:8080/          # æ˜¾ç¤ºè‡ªå®šä¹‰é¡µé¢
http://yourserver:8080/docs/     # 404é”™è¯¯
http://yourserver:8080/examples/ # 404é”™è¯¯
```

### 2.4 æ‰¹é‡æ¸…ç†è„šæœ¬


**âš¡ è‡ªåŠ¨åŒ–æ¸…ç†è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æ–‡ä»¶åï¼šcleanup-defaults.sh

TOMCAT_HOME="/opt/tomcat"
WEBAPPS_DIR="$TOMCAT_HOME/webapps"

echo "å¼€å§‹æ¸…ç†Tomcaté»˜è®¤åº”ç”¨..."

# æ£€æŸ¥Tomcatæ˜¯å¦è¿è¡Œ
if pgrep -f tomcat > /dev/null; then
    echo "è­¦å‘Šï¼šTomcatæ­£åœ¨è¿è¡Œï¼Œå»ºè®®å…ˆåœæ­¢æœåŠ¡"
    echo "æ‰§è¡Œï¼šsudo systemctl stop tomcat"
    exit 1
fi

# å¤‡ä»½å½“å‰webapps
backup_dir="$TOMCAT_HOME/webapps_backup_$(date +%Y%m%d_%H%M%S)"
cp -r "$WEBAPPS_DIR" "$backup_dir"
echo "å·²å¤‡ä»½åˆ°ï¼š$backup_dir"

# åˆ é™¤é»˜è®¤åº”ç”¨
cd "$WEBAPPS_DIR"
for app in ROOT docs examples host-manager; do
    if [ -d "$app" ]; then
        rm -rf "$app"
        echo "å·²åˆ é™¤ï¼š$app"
    fi
done

# åˆ›å»ºå®‰å…¨çš„ROOTåº”ç”¨
mkdir -p ROOT
cat > ROOT/index.html << 'EOF'
<!DOCTYPE html>
<html>
<head><title>System Online</title></head>
<body><h2>Service Available</h2></body>
</html>
EOF

echo "æ¸…ç†å®Œæˆï¼è¯·å¯åŠ¨Tomcatå¹¶éªŒè¯ï¼šsudo systemctl start tomcat"
```

---

## 3. ğŸš« ç¦ç”¨ç®¡ç†ç•Œé¢


### 3.1 ç®¡ç†ç•Œé¢çš„å®‰å…¨é£é™©


**ğŸ¯ é£é™©ç†è§£**ï¼š
ç®¡ç†ç•Œé¢å°±åƒä½ å®¶çš„æ€»ç”µé—¸ï¼Œå¦‚æœè¢«åäººæ§åˆ¶ï¼Œæ•´ä¸ªæˆ¿å­çš„ç”µå™¨éƒ½èƒ½è¢«æ“æ§ï¼

```
ğŸ” Tomcatç®¡ç†ç•Œé¢é£é™©ï¼š
/manager/html    â† Webåº”ç”¨ç®¡ç†ç•Œé¢
/manager/text    â† å‘½ä»¤è¡Œç®¡ç†æ¥å£  
/host-manager/   â† è™šæ‹Ÿä¸»æœºç®¡ç†

å¦‚æœè¢«æ¶æ„è®¿é—®ï¼š
âŒ å¯ä»¥éƒ¨ç½²æ¶æ„åº”ç”¨
âŒ å¯ä»¥åˆ é™¤ç°æœ‰åº”ç”¨
âŒ å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯
âŒ å¯ä»¥æ§åˆ¶æ•´ä¸ªæœåŠ¡å™¨
```

### 3.2 å®Œå…¨ç¦ç”¨ç®¡ç†ç•Œé¢


**æ–¹æ³•ä¸€ï¼šåˆ é™¤ç®¡ç†åº”ç”¨ï¼ˆæ¨èï¼‰**
```bash
# æœ€å½»åº•çš„æ–¹æ³•ï¼šç›´æ¥åˆ é™¤
cd /opt/tomcat/webapps
sudo rm -rf manager host-manager

# éªŒè¯åˆ é™¤æ•ˆæœ
ls -la  # ä¸åº”è¯¥çœ‹åˆ°managerç›®å½•
```

**æ–¹æ³•äºŒï¼šé€šè¿‡é…ç½®ç¦ç”¨**
å¦‚æœå°†æ¥å¯èƒ½éœ€è¦ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥é€šè¿‡é…ç½®ä¸´æ—¶ç¦ç”¨ï¼š

```xml
<!-- ç¼–è¾‘ conf/server.xml -->
<!-- æ³¨é‡Šæ‰æˆ–åˆ é™¤ç®¡ç†åº”ç”¨çš„Context -->
<!--
<Context path="/manager" 
         docBase="/opt/tomcat/webapps/manager"
         privileged="true" />
-->
```

### 3.3 ç½‘ç»œå±‚é¢çš„è®¿é—®æ§åˆ¶


**ğŸŒ é˜²ç«å¢™é…ç½®**ï¼š
å¦‚æœå¿…é¡»ä¿ç•™ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥é™åˆ¶è®¿é—®æ¥æºï¼š

```bash
# åªå…è®¸æœ¬åœ°è®¿é—®ç®¡ç†ç•Œé¢
sudo iptables -A INPUT -p tcp --dport 8080 -s 127.0.0.1 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8080 -s 10.0.0.0/24 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8080 -j DROP

# ä¿å­˜é˜²ç«å¢™è§„åˆ™
sudo iptables-save > /etc/iptables/rules.v4
```

**ğŸ”§ åº”ç”¨çº§è®¿é—®æ§åˆ¶**ï¼š
ç¼–è¾‘ç®¡ç†åº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼š

```xml
<!-- webapps/manager/META-INF/context.xml -->
<Context antiResourceLocking="false" privileged="true">
  <!-- åªå…è®¸æœ¬åœ°ç½‘ç»œè®¿é—® -->
  <Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.0\.0\.1|192\.168\..*|10\.0\.0\..*" />
</Context>
```

### 3.4 ç›‘æ§ç®¡ç†ç•Œé¢è®¿é—®


**ğŸ“Š è®¿é—®æ—¥å¿—ç›‘æ§**ï¼š
```bash
# ç›‘æ§ç®¡ç†ç•Œé¢çš„è®¿é—®å°è¯•
tail -f /opt/tomcat/logs/localhost_access_log.*.txt | grep -E "/manager|/host-manager"

# è®¾ç½®å‘Šè­¦è„šæœ¬
#!/bin/bash
# check-admin-access.sh
LOG_FILE="/opt/tomcat/logs/localhost_access_log.$(date +%Y-%m-%d).txt"

# æ£€æŸ¥æ˜¯å¦æœ‰ç®¡ç†ç•Œé¢è®¿é—®
if grep -q "/manager" "$LOG_FILE" 2>/dev/null; then
    echo "è­¦å‘Šï¼šæ£€æµ‹åˆ°ç®¡ç†ç•Œé¢è®¿é—®å°è¯•" | mail -s "å®‰å…¨å‘Šè­¦" admin@company.com
fi
```

---

## 4. ğŸ‘¤ ç”¨æˆ·æƒé™æ§åˆ¶


### 4.1 æƒé™æ§åˆ¶åŸºæœ¬æ¦‚å¿µ


**ğŸ­ è§’è‰²æƒé™ç±»æ¯”**ï¼š
```
å…¬å¸æƒé™ä½“ç³»ï¼š                Tomcatæƒé™ä½“ç³»ï¼š
CEO (æœ€é«˜æƒé™)      â†â†’      admin (ç®¡ç†å‘˜)
éƒ¨é—¨ç»ç† (éƒ¨é—¨æƒé™)   â†â†’      manager-gui (Webç®¡ç†)
æ™®é€šå‘˜å·¥ (åŸºç¡€æƒé™)   â†â†’      manager-script (è„šæœ¬ç®¡ç†)
è®¿å®¢ (åªè¯»æƒé™)      â†â†’      æ— æƒé™ç”¨æˆ·

åŸåˆ™ï¼šæ¯ä¸ªäººåªæœ‰å®Œæˆå·¥ä½œæ‰€éœ€çš„æœ€å°æƒé™
```

### 4.2 Tomcatç”¨æˆ·é…ç½®


**ğŸ“ ç”¨æˆ·é…ç½®æ–‡ä»¶**ï¼š`conf/tomcat-users.xml`

**é»˜è®¤é…ç½®çš„é—®é¢˜**ï¼š
```xml
<!-- å±é™©çš„é»˜è®¤é…ç½®ç¤ºä¾‹ -->
<tomcat-users>
  <user username="admin" password="admin" roles="manager-gui,admin-gui"/>
  <user username="tomcat" password="tomcat" roles="manager-gui"/>
</tomcat-users>
```

**ğŸ” å®‰å…¨é…ç½®å»ºè®®**ï¼š
```xml
<!-- å®‰å…¨çš„ç”¨æˆ·é…ç½® -->
<tomcat-users>
  <!-- ä½¿ç”¨å¼ºå¯†ç å’Œéé»˜è®¤ç”¨æˆ·å -->
  <role rolename="manager-script"/>
  <role rolename="manager-gui"/>
  
  <!-- ç”Ÿäº§ç¯å¢ƒå»ºè®®åªä¿ç•™scriptæ¥å£ï¼Œç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½² -->
  <user username="deploy_user_2024" 
        password="StrongP@ssw0rd!2024" 
        roles="manager-script"/>
  
  <!-- å¦‚æœéœ€è¦Webç•Œé¢ï¼Œä½¿ç”¨ç‹¬ç«‹ç”¨æˆ· -->
  <user username="web_admin_2024" 
        password="C0mpl3xP@ssw0rd!" 
        roles="manager-gui"/>
</tomcat-users>
```

### 4.3 æƒé™è§’è‰²è¯¦è§£


**ğŸ¯ Tomcatå†…ç½®è§’è‰²è¯´æ˜**ï¼š

| è§’è‰²åç§° | **æƒé™èŒƒå›´** | **é€‚ç”¨åœºæ™¯** | **é£é™©ç­‰çº§** |
|----------|-------------|-------------|-------------|
| `admin-gui` | `ç®¡ç†TomcatæœåŠ¡å™¨` | `ç³»ç»Ÿç®¡ç†å‘˜` | `ğŸ”´ æé«˜` |
| `admin-script` | `è„šæœ¬ç®¡ç†æœåŠ¡å™¨` | `è‡ªåŠ¨åŒ–è„šæœ¬` | `ğŸ”´ æé«˜` |
| `manager-gui` | `Webåº”ç”¨ç®¡ç†ç•Œé¢` | `åº”ç”¨éƒ¨ç½²äººå‘˜` | `ğŸŸ¡ é«˜` |
| `manager-script` | `è„šæœ¬éƒ¨ç½²åº”ç”¨` | `CI/CDç³»ç»Ÿ` | `ğŸŸ¡ é«˜` |
| `manager-jmx` | `JMXç›‘æ§ç®¡ç†` | `ç›‘æ§ç³»ç»Ÿ` | `ğŸŸ¢ ä¸­` |
| `manager-status` | `æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯` | `è¿ç»´ç›‘æ§` | `ğŸŸ¢ ä½` |

**ğŸ’¡ æƒé™åˆ†é…å»ºè®®**ï¼š
```
ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®ï¼š
âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šåªç»™manager-scriptæƒé™
âœ… ç›‘æ§ç³»ç»Ÿï¼šåªç»™manager-statusæƒé™
âœ… åº”æ€¥å¤„ç†ï¼šä¸´æ—¶å¯ç”¨manager-guiï¼ˆç”¨å®Œå³åˆ ï¼‰
âŒ é¿å…admin-guiï¼šé™¤éç»å¯¹å¿…è¦
```

### 4.4 é«˜çº§æƒé™æ§åˆ¶


**ğŸ”’ åŸºäºIPçš„æƒé™æ§åˆ¶**ï¼š
```xml
<!-- server.xml ä¸­é…ç½®è®¿é—®æ§åˆ¶ -->
<Context path="/manager" docBase="${catalina.home}/webapps/manager"
         privileged="true">
  <!-- é™åˆ¶ç®¡ç†ç•Œé¢åªèƒ½ä»ç‰¹å®šIPè®¿é—® -->
  <Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="192\.168\.1\.100|10\.0\.0\.5" />
</Context>
```

**â° åŸºäºæ—¶é—´çš„æƒé™æ§åˆ¶**ï¼š
```bash
#!/bin/bash
# auto-disable-admin.sh - å®šæ—¶ç¦ç”¨ç®¡ç†æƒé™

# å·¥ä½œæ—¶é—´å¯ç”¨ç®¡ç†æƒé™ï¼ˆ9:00-18:00ï¼‰
current_hour=$(date +%H)
if [ "$current_hour" -ge 9 ] && [ "$current_hour" -lt 18 ]; then
    # å¯ç”¨ç®¡ç†ç”¨æˆ·
    sed -i 's/<!-- <user username="admin"/  <user username="admin"/' /opt/tomcat/conf/tomcat-users.xml
    sed -i 's/roles="manager-gui"\/> -->/roles="manager-gui"\/>/' /opt/tomcat/conf/tomcat-users.xml
else
    # ç¦ç”¨ç®¡ç†ç”¨æˆ·
    sed -i 's/<user username="admin"/<!-- <user username="admin"/' /opt/tomcat/conf/tomcat-users.xml
    sed -i 's/roles="manager-gui"\/>/roles="manager-gui"\/> -->/' /opt/tomcat/conf/tomcat-users.xml
fi

# é‡æ–°åŠ è½½é…ç½®
systemctl reload tomcat
```

---

## 5. ğŸš§ é˜²æ­¢ç›®å½•éå†æ”»å‡»


### 5.1 ä»€ä¹ˆæ˜¯ç›®å½•éå†æ”»å‡»


**ğŸ“‚ ç”Ÿæ´»ç±»æ¯”ç†è§£**ï¼š
```
æƒ³è±¡ä½ çš„ç”µè„‘å°±åƒä¸€ä¸ªå›¾ä¹¦é¦†ï¼š
æ­£å¸¸è®¿é—®ï¼šè®¿å®¢åªèƒ½çœ‹æŒ‡å®šçš„ä¹¦æ¶ï¼ˆwebappç›®å½•ï¼‰
ç›®å½•éå†æ”»å‡»ï¼šåäººæƒ³çœ‹ç®¡ç†å‘˜åŠå…¬å®¤çš„æ–‡ä»¶ï¼ˆç³»ç»Ÿç›®å½•ï¼‰

æ”»å‡»æ–¹å¼ï¼š
http://yoursite.com/app/../../../etc/passwd
                      â†‘
                 è¿™äº›"../"å°±åƒå·å·çˆ¬æ¥¼æ¢¯
                 æƒ³è®¿é—®ä¸è¯¥çœ‹çš„åœ°æ–¹
```

### 5.2 ç›®å½•éå†æ”»å‡»åŸç†


**ğŸ¯ æ”»å‡»ç¤ºä¾‹åˆ†æ**ï¼š
```
æ­£å¸¸è¯·æ±‚ï¼š
http://example.com/myapp/images/logo.png
â†’ è®¿é—®ï¼š/opt/tomcat/webapps/myapp/images/logo.png âœ…

æ¶æ„è¯·æ±‚ï¼š
http://example.com/myapp/../../conf/tomcat-users.xml
â†’ å°è¯•è®¿é—®ï¼š/opt/tomcat/conf/tomcat-users.xml âŒ

æ›´å±é™©çš„è¯·æ±‚ï¼š
http://example.com/myapp/../../../etc/passwd
â†’ å°è¯•è®¿é—®ï¼š/etc/passwd (ç³»ç»Ÿç”¨æˆ·æ–‡ä»¶) âŒâŒâŒ
```

**ğŸ” æ”»å‡»æ£€æµ‹æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥è®¿é—®æ—¥å¿—ä¸­çš„å¯ç–‘è¯·æ±‚
grep -E "\.\./|%2e%2e%2f|%252e%252e%252f" /opt/tomcat/logs/localhost_access_log.*.txt

# å¸¸è§æ”»å‡»æ¨¡å¼ï¼š
../../../           # ç›´æ¥è·¯å¾„éå†
%2e%2e%2f          # URLç¼–ç çš„../
%252e%252e%252f    # åŒé‡ç¼–ç çš„../
```

### 5.3 é˜²æŠ¤é…ç½®å®æ–½


**ğŸ›¡ï¸ Tomcaté…ç½®é˜²æŠ¤**ï¼š

åœ¨`conf/web.xml`ä¸­æ·»åŠ å®‰å…¨çº¦æŸï¼š
```xml
<web-app>
  <!-- ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶ -->
  <security-constraint>
    <web-resource-collection>
      <web-resource-name>Restricted Files</web-resource-name>
      <url-pattern>*.xml</url-pattern>
      <url-pattern>*.properties</url-pattern>
      <url-pattern>*.conf</url-pattern>
    </web-resource-collection>
    <auth-constraint/>
  </security-constraint>

  <!-- ç¦æ­¢ç›®å½•éå† -->
  <security-constraint>
    <web-resource-collection>
      <web-resource-name>Directory Traversal</web-resource-name>
      <url-pattern>*../*</url-pattern>
    </web-resource-collection>
    <auth-constraint/>
  </security-constraint>
</web-app>
```

**ğŸ”§ åº”ç”¨å±‚é˜²æŠ¤**ï¼š
```java
// åœ¨Javaåº”ç”¨ä¸­éªŒè¯æ–‡ä»¶è·¯å¾„
public class FileAccessUtil {
    private static final String BASE_PATH = "/opt/tomcat/webapps/myapp/";
    
    public static boolean isValidPath(String requestPath) {
        try {
            // è·å–è§„èŒƒåŒ–è·¯å¾„
            Path normalizedPath = Paths.get(BASE_PATH + requestPath).normalize();
            Path basePath = Paths.get(BASE_PATH).normalize();
            
            // æ£€æŸ¥æ˜¯å¦åœ¨å…è®¸çš„ç›®å½•å†…
            return normalizedPath.startsWith(basePath);
        } catch (Exception e) {
            return false;
        }
    }
}
```

### 5.4 WebæœåŠ¡å™¨å±‚é¢é˜²æŠ¤


**ğŸŒ Nginxåå‘ä»£ç†é˜²æŠ¤**ï¼š
```nginx
server {
    listen 80;
    server_name yourdomain.com;
    
    # é˜»æ­¢ç›®å½•éå†æ”»å‡»
    location ~ \.\./  {
        deny all;
        access_log /var/log/nginx/directory_traversal.log;
    }
    
    # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~ \.(xml|properties|conf|log)$ {
        deny all;
    }
    
    # åå‘ä»£ç†åˆ°Tomcat
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

**ğŸ” ç›‘æ§å’Œå‘Šè­¦**ï¼š
```bash
#!/bin/bash
# monitor-directory-traversal.sh

LOG_FILE="/opt/tomcat/logs/localhost_access_log.$(date +%Y-%m-%d).txt"
ALERT_EMAIL="security@company.com"

# æ£€æŸ¥ç›®å½•éå†æ”»å‡»
if grep -E "\.\./|%2e%2e" "$LOG_FILE" > /tmp/traversal_attempts.txt 2>/dev/null; then
    if [ -s /tmp/traversal_attempts.txt ]; then
        echo "æ£€æµ‹åˆ°ç›®å½•éå†æ”»å‡»å°è¯•ï¼š" | mail -s "å®‰å…¨å‘Šè­¦" "$ALERT_EMAIL"
        cat /tmp/traversal_attempts.txt | mail -s "æ”»å‡»è¯¦æƒ…" "$ALERT_EMAIL"
    fi
fi
```

---

## 6. ğŸ•¶ï¸ éšè—ç‰ˆæœ¬ä¿¡æ¯


### 6.1 ä¸ºä»€ä¹ˆè¦éšè—ç‰ˆæœ¬ä¿¡æ¯


**ğŸ¯ ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²çš„å±é™©**ï¼š
```
å°±åƒå°å·è¸©ç‚¹ä¸€æ ·ï¼š
ğŸ  æˆ¿å­è´´ç€"ä½¿ç”¨XXç‰Œé˜²ç›—é”"
â†’ å°å·çŸ¥é“è¿™æ¬¾é”çš„å¼±ç‚¹
â†’ é’ˆå¯¹æ€§ç ´è§£

ğŸ–¥ï¸ ç½‘ç«™æ˜¾ç¤º"Tomcat 8.5.50"  
â†’ é»‘å®¢æŸ¥æ‰¾è¿™ä¸ªç‰ˆæœ¬çš„æ¼æ´
â†’ å‘èµ·é’ˆå¯¹æ€§æ”»å‡»

éšè—ä¿¡æ¯åï¼š
ğŸ”’ ä¸çŸ¥é“å…·ä½“ç‰ˆæœ¬ï¼Œæ”»å‡»éš¾åº¦å¢åŠ 
ğŸ”’ éœ€è¦å°è¯•å„ç§æ–¹æ³•ï¼ŒæˆåŠŸç‡é™ä½
```

### 6.2 å¸¸è§ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²ç‚¹


**ğŸ“ ä¿¡æ¯æ³„éœ²æ£€æŸ¥æ¸…å•**ï¼š
```
HTTPå“åº”å¤´ä¿¡æ¯ï¼š
Server: Apache-Coyote/1.1    â† æ³„éœ²Tomcatä¿¡æ¯
X-Powered-By: Servlet/3.0    â† æ³„éœ²Servletç‰ˆæœ¬

é”™è¯¯é¡µé¢ï¼š
Apache Tomcat/8.5.50 - Error report â† å®Œæ•´ç‰ˆæœ¬ä¿¡æ¯
HTTP Status 404 â€“ Not Found

é»˜è®¤é¡µé¢ï¼š
"Apache Tomcat/8.5.50" æ¬¢è¿é¡µé¢

ç®¡ç†ç•Œé¢ï¼š
æ˜¾ç¤ºå®Œæ•´çš„Tomcatç‰ˆæœ¬å’Œç³»ç»Ÿä¿¡æ¯
```

**ğŸ” ç‰ˆæœ¬ä¿¡æ¯æ£€æµ‹æ–¹æ³•**ï¼š
```bash
# ä½¿ç”¨curlæ£€æŸ¥HTTPå¤´
curl -I http://yourserver:8080/

# ä½¿ç”¨nmapæ£€æµ‹æœåŠ¡ç‰ˆæœ¬
nmap -sV -p 8080 yourserver

# æ£€æŸ¥é”™è¯¯é¡µé¢
curl http://yourserver:8080/nonexistent-page
```

### 6.3 éšè—HTTPå“åº”å¤´ä¿¡æ¯


**ğŸ”§ ä¿®æ”¹server.xmlé…ç½®**ï¼š
```xml
<!-- conf/server.xml -->
<Connector port="8080" protocol="HTTP/1.1"
           connectionTimeout="20000"
           redirectPort="8443"
           server="Web Server"
           xpoweredBy="false" />
           
<!-- 
server="Web Server"     - è‡ªå®šä¹‰æœåŠ¡å™¨æ ‡è¯†
xpoweredBy="false"     - ä¸æ˜¾ç¤ºX-Powered-Byå¤´
-->
```

**ğŸ¨ è‡ªå®šä¹‰æœåŠ¡å™¨æ ‡è¯†**ï¼š
```xml
<!-- å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ æƒ³è¦çš„åç§° -->
<Connector port="8080" protocol="HTTP/1.1"
           server="MyCompany-WebServer/1.0" />

<!-- æˆ–è€…å®Œå…¨éšè— -->
<Connector port="8080" protocol="HTTP/1.1"
           server="" />
```

### 6.4 è‡ªå®šä¹‰é”™è¯¯é¡µé¢


**ğŸ“„ åˆ›å»ºé€šç”¨é”™è¯¯é¡µé¢**ï¼š
```html
<!-- webapps/ROOT/error.html -->
<!DOCTYPE html>
<html>
<head>
    <title>é¡µé¢é”™è¯¯</title>
    <style>
        body { font-family: Arial; text-align: center; margin-top: 50px; }
        .error-box { max-width: 400px; margin: 0 auto; }
    </style>
</head>
<body>
    <div class="error-box">
        <h2>é¡µé¢æ— æ³•è®¿é—®</h2>
        <p>è¯·æ£€æŸ¥URLåœ°å€æ˜¯å¦æ­£ç¡®</p>
        <a href="/">è¿”å›é¦–é¡µ</a>
    </div>
</body>
</html>
```

**âš™ï¸ é…ç½®é”™è¯¯é¡µé¢æ˜ å°„**ï¼š
```xml
<!-- web.xmlä¸­é…ç½® -->
<error-page>
    <error-code>404</error-code>
    <location>/error.html</location>
</error-page>

<error-page>
    <error-code>500</error-code>
    <location>/error.html</location>
</error-page>

<error-page>
    <exception-type>java.lang.Exception</exception-type>
    <location>/error.html</location>
</error-page>
```

### 6.5 ç‰ˆæœ¬ä¿¡æ¯éšè—éªŒè¯


**âœ… éšè—æ•ˆæœéªŒè¯è„šæœ¬**ï¼š
```bash
#!/bin/bash
# verify-version-hiding.sh

SERVER_URL="http://localhost:8080"
echo "æ­£åœ¨æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯éšè—æ•ˆæœ..."

echo "1. æ£€æŸ¥HTTPå“åº”å¤´ï¼š"
curl -I "$SERVER_URL" 2>/dev/null | grep -E "Server:|X-Powered-By:"

echo -e "\n2. æ£€æŸ¥404é”™è¯¯é¡µé¢ï¼š"
curl -s "$SERVER_URL/nonexistent-page" | grep -i tomcat

echo -e "\n3. æ£€æŸ¥é»˜è®¤ROOTé¡µé¢ï¼š"
curl -s "$SERVER_URL" | grep -i tomcat

echo -e "\nå¦‚æœä»¥ä¸Šå‘½ä»¤æ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜ç‰ˆæœ¬ä¿¡æ¯éšè—æˆåŠŸï¼"
```

---

## 7. ğŸ” è®¿é—®æ§åˆ¶é…ç½®


### 7.1 è®¿é—®æ§åˆ¶åŸºæœ¬æ¦‚å¿µ


**ğŸ¢ è®¿é—®æ§åˆ¶ç±»æ¯”**ï¼š
```
åŠå…¬æ¥¼è®¿é—®æ§åˆ¶ï¼š                ç½‘ç«™è®¿é—®æ§åˆ¶ï¼š
é—¨ç¦å¡ â†â†’ ç”¨æˆ·è®¤è¯
æ¥¼å±‚æƒé™ â†â†’ URLè·¯å¾„æƒé™
è®¿å®¢ç™»è®° â†â†’ è®¿é—®æ—¥å¿—
å®‰ä¿å·¡æŸ¥ â†â†’ å®æ—¶ç›‘æ§

ç›®æ ‡ï¼šç¡®ä¿åˆé€‚çš„äººåœ¨åˆé€‚çš„æ—¶é—´è®¿é—®åˆé€‚çš„èµ„æº
```

### 7.2 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶


**ğŸ‘¥ è§’è‰²æƒé™é…ç½®**ï¼š
```xml
<!-- web.xml é…ç½®ç¤ºä¾‹ -->
<web-app>
  <!-- å®šä¹‰å®‰å…¨è§’è‰² -->
  <security-role>
    <role-name>admin</role-name>
  </security-role>
  <security-role>
    <role-name>user</role-name>
  </security-role>
  <security-role>
    <role-name>guest</role-name>
  </security-role>

  <!-- ç®¡ç†å‘˜åŒºåŸŸè®¿é—®æ§åˆ¶ -->
  <security-constraint>
    <web-resource-collection>
      <web-resource-name>Admin Area</web-resource-name>
      <url-pattern>/admin/*</url-pattern>
      <http-method>GET</http-method>
      <http-method>POST</http-method>
    </web-resource-collection>
    <auth-constraint>
      <role-name>admin</role-name>
    </auth-constraint>
  </security-constraint>

  <!-- ç”¨æˆ·åŒºåŸŸè®¿é—®æ§åˆ¶ -->
  <security-constraint>
    <web-resource-collection>
      <web-resource-name>User Area</web-resource-name>
      <url-pattern>/user/*</url-pattern>
    </web-resource-collection>
    <auth-constraint>
      <role-name>admin</role-name>
      <role-name>user</role-name>
    </auth-constraint>
  </security-constraint>
</web-app>
```

### 7.3 IPç™½åå•è®¿é—®æ§åˆ¶


**ğŸŒ åŸºäºIPåœ°å€çš„è®¿é—®æ§åˆ¶**ï¼š
```xml
<!-- Context.xml æˆ– server.xml ä¸­é…ç½® -->
<Context>
  <!-- åªå…è®¸å†…ç½‘IPè®¿é—® -->
  <Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.0\.0\.1|192\.168\..*|10\.0\.0\..*"
         deny="" />
</Context>
```

**ğŸ“Š è®¿é—®æ§åˆ¶é…ç½®å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | **è¯´æ˜** | **ç¤ºä¾‹** | **ç”¨é€”** |
|------|----------|----------|----------|
| `allow` | `å…è®¸è®¿é—®çš„IPæ¨¡å¼` | `192\.168\..*` | `ç™½åå•æ§åˆ¶` |
| `deny` | `æ‹’ç»è®¿é—®çš„IPæ¨¡å¼` | `192\.168\.1\.100` | `é»‘åå•æ§åˆ¶` |
| `allowValid` | `å…è®¸é€šè¿‡è®¤è¯çš„è¯·æ±‚` | `true` | `è®¤è¯ç»•è¿‡` |
| `denyStatus` | `æ‹’ç»è®¿é—®çš„çŠ¶æ€ç ` | `403` | `è‡ªå®šä¹‰é”™è¯¯ç ` |

### 7.4 æ—¶é—´æ®µè®¿é—®æ§åˆ¶


**â° åŸºäºæ—¶é—´çš„è®¿é—®æ§åˆ¶**ï¼š
```java
// è‡ªå®šä¹‰æ—¶é—´è®¿é—®æ§åˆ¶Filter
public class TimeBasedAccessFilter implements Filter {
    
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // è·å–å½“å‰æ—¶é—´
        int currentHour = LocalTime.now().getHour();
        int dayOfWeek = LocalDate.now().getDayOfWeek().getValue();
        
        // å·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€åˆ°å‘¨äº” 9:00-18:00
        boolean isWorkingTime = (dayOfWeek <= 5) && 
                               (currentHour >= 9 && currentHour < 18);
        
        if (!isWorkingTime) {
            HttpServletResponse httpResponse = (HttpServletResponse) response;
            httpResponse.sendError(HttpServletResponse.SC_FORBIDDEN, 
                                 "ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œè¯·åœ¨å·¥ä½œæ—¶é—´è®¿é—®");
            return;
        }
        
        chain.doFilter(request, response);
    }
}
```

**ğŸ“… æ—¶é—´æ§åˆ¶é…ç½®**ï¼š
```xml
<!-- web.xml ä¸­é…ç½®æ—¶é—´è¿‡æ»¤å™¨ -->
<filter>
    <filter-name>TimeBasedAccessFilter</filter-name>
    <filter-class>com.company.security.TimeBasedAccessFilter</filter-class>
</filter>

<filter-mapping>
    <filter-name>TimeBasedAccessFilter</filter-name>
    <url-pattern>/admin/*</url-pattern>
</filter-mapping>
```

### 7.5 è®¿é—®æ—¥å¿—ç›‘æ§


**ğŸ“Š è®¿é—®æ—¥å¿—é…ç½®**ï¼š
```xml
<!-- server.xml ä¸­é…ç½®è¯¦ç»†çš„è®¿é—®æ—¥å¿— -->
<Valve className="org.apache.catalina.valves.AccessLogValve" 
       directory="logs"
       prefix="access_log" 
       suffix=".txt"
       pattern="%h %l %u %t &quot;%r&quot; %s %b %D &quot;%{Referer}i&quot; &quot;%{User-Agent}i&quot; %{X-Forwarded-For}i" />
       
<!-- 
%h - å®¢æˆ·ç«¯IPåœ°å€
%t - è®¿é—®æ—¶é—´
%r - è¯·æ±‚è¡Œ
%s - çŠ¶æ€ç 
%D - å¤„ç†æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
-->
```

**ğŸ” å®æ—¶ç›‘æ§è„šæœ¬**ï¼š
```bash
#!/bin/bash
# real-time-monitor.sh

LOG_FILE="/opt/tomcat/logs/access_log.$(date +%Y-%m-%d).txt"

# å®æ—¶ç›‘æ§å¯ç–‘è®¿é—®
tail -f "$LOG_FILE" | while read line; do
    # æ£€æŸ¥404é”™è¯¯ï¼ˆå¯èƒ½çš„æ‰«æè¡Œä¸ºï¼‰
    if echo "$line" | grep -q " 404 "; then
        echo "[$(date)] å¯ç–‘404è¯·æ±‚: $line"
    fi
    
    # æ£€æŸ¥ç®¡ç†ç•Œé¢è®¿é—®
    if echo "$line" | grep -qE "/manager|/admin"; then
        echo "[$(date)] ç®¡ç†ç•Œé¢è®¿é—®: $line"
    fi
    
    # æ£€æŸ¥å¤§é‡è¯·æ±‚ï¼ˆå¯èƒ½çš„DOSæ”»å‡»ï¼‰
    ip=$(echo "$line" | awk '{print $1}')
    count=$(grep -c "$ip" "$LOG_FILE")
    if [ "$count" -gt 100 ]; then
        echo "[$(date)] é«˜é¢‘è®¿é—®IP: $ip ($countæ¬¡)"
    fi
done
```

**ğŸ“ˆ è®¿é—®ç»Ÿè®¡åˆ†æ**ï¼š
```bash
#!/bin/bash
# access-analysis.sh

LOG_FILE="/opt/tomcat/logs/access_log.$(date +%Y-%m-%d).txt"

echo "=== ä»Šæ—¥è®¿é—®ç»Ÿè®¡ ==="
echo "æ€»è®¿é—®æ¬¡æ•°: $(wc -l < "$LOG_FILE")"
echo "ç‹¬ç«‹IPæ•°: $(awk '{print $1}' "$LOG_FILE" | sort | uniq | wc -l)"
echo "çŠ¶æ€ç ç»Ÿè®¡:"
awk '{print $9}' "$LOG_FILE" | sort | uniq -c | sort -nr

echo -e "\n=== Top 10 è®¿é—®IP ==="
awk '{print $1}' "$LOG_FILE" | sort | uniq -c | sort -nr | head -10

echo -e "\n=== Top 10 è®¿é—®é¡µé¢ ==="
awk '{print $7}' "$LOG_FILE" | sort | uniq -c | sort -nr | head -10

echo -e "\n=== å¼‚å¸¸è®¿é—®æ£€æŸ¥ ==="
echo "404é”™è¯¯æ•°: $(grep -c ' 404 ' "$LOG_FILE")"
echo "500é”™è¯¯æ•°: $(grep -c ' 500 ' "$LOG_FILE")"
echo "å¯ç–‘æ‰«æ: $(grep -cE '\.\./|\.\.\%2f' "$LOG_FILE")"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„å®‰å…¨åŸºç¡€


```
ğŸ”¸ å®‰å…¨åŠ å›ºæœ¬è´¨ï¼šå»ºç«‹å¤šå±‚é˜²æŠ¤ä½“ç³»ï¼Œéµå¾ªæœ€å°æƒé™åŸåˆ™
ğŸ”¸ é»˜è®¤åº”ç”¨é£é™©ï¼šé¢„è£…åº”ç”¨æ˜¯æ”»å‡»å…¥å£ï¼Œå¿…é¡»æ¸…ç†
ğŸ”¸ ç®¡ç†ç•Œé¢æ§åˆ¶ï¼šç”Ÿäº§ç¯å¢ƒåº”ç¦ç”¨æˆ–ä¸¥æ ¼é™åˆ¶è®¿é—®
ğŸ”¸ æƒé™æœ€å°åŒ–ï¼šæ¯ä¸ªç”¨æˆ·åªç»™å®Œæˆå·¥ä½œå¿…éœ€çš„æœ€å°æƒé™
ğŸ”¸ ç›®å½•éå†é˜²æŠ¤ï¼šé˜»æ­¢é€šè¿‡../ç­‰æ–¹å¼è®¿é—®ç³»ç»Ÿæ–‡ä»¶
ğŸ”¸ ç‰ˆæœ¬ä¿¡æ¯éšè—ï¼šä¸ç»™æ”»å‡»è€…æä¾›é’ˆå¯¹æ€§æ”»å‡»çš„ä¿¡æ¯
ğŸ”¸ è®¿é—®æ§åˆ¶é…ç½®ï¼šåŸºäºè§’è‰²ã€IPã€æ—¶é—´ç­‰å¤šç»´åº¦æ§åˆ¶
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®‰å…¨åŠ å›ºçš„æ ¸å¿ƒæ€ç»´**ï¼š
```
çºµæ·±é˜²å¾¡ç­–ç•¥ï¼š
â€¢ ç½‘ç»œå±‚ï¼šé˜²ç«å¢™ã€VPN
â€¢ ç³»ç»Ÿå±‚ï¼šæƒé™æ§åˆ¶ã€æœåŠ¡åŠ å›º  
â€¢ åº”ç”¨å±‚ï¼šè¾“å…¥éªŒè¯ã€è®¿é—®æ§åˆ¶
â€¢ æ•°æ®å±‚ï¼šåŠ å¯†å­˜å‚¨ã€å¤‡ä»½

æœ€å°æš´éœ²åŸåˆ™ï¼š
â€¢ åªå¼€æ”¾å¿…è¦çš„ç«¯å£
â€¢ åªä¿ç•™å¿…è¦çš„åŠŸèƒ½
â€¢ åªç»™å¿…è¦çš„æƒé™
â€¢ åªæ˜¾ç¤ºå¿…è¦çš„ä¿¡æ¯
```

**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥æ¸…å•**ï¼š
```
éƒ¨ç½²å‰æ£€æŸ¥ï¼š
â˜‘ï¸ åˆ é™¤æ‰€æœ‰é»˜è®¤åº”ç”¨å’Œç¤ºä¾‹ä»£ç 
â˜‘ï¸ ç¦ç”¨æˆ–é™åˆ¶ç®¡ç†ç•Œé¢è®¿é—®
â˜‘ï¸ é…ç½®å¼ºå¯†ç å’Œéé»˜è®¤ç”¨æˆ·å
â˜‘ï¸ éšè—ç‰ˆæœ¬ä¿¡æ¯å’Œé”™è¯¯è¯¦æƒ…
â˜‘ï¸ é…ç½®é€‚å½“çš„è®¿é—®æ§åˆ¶ç­–ç•¥
â˜‘ï¸ å¯ç”¨è¯¦ç»†çš„è®¿é—®æ—¥å¿—è®°å½•

è¿è¡Œæ—¶ç›‘æ§ï¼š
â˜‘ï¸ å®šæœŸæ£€æŸ¥è®¿é—®æ—¥å¿—å¼‚å¸¸
â˜‘ï¸ ç›‘æ§ç®¡ç†ç•Œé¢è®¿é—®å°è¯•
â˜‘ï¸ æ£€æŸ¥ç³»ç»Ÿè´¦æˆ·å®‰å…¨çŠ¶æ€
â˜‘ï¸ éªŒè¯é˜²æŠ¤æªæ–½æœ‰æ•ˆæ€§
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ ä¸åŒç¯å¢ƒçš„å®‰å…¨ç­–ç•¥**ï¼š
```
å¼€å‘ç¯å¢ƒï¼š
â€¢ ä¿ç•™ç®¡ç†ç•Œé¢ä¾¿äºè°ƒè¯•
â€¢ ä½¿ç”¨ç®€å•å¯†ç ï¼ˆä½†ä¸æ˜¯é»˜è®¤å¯†ç ï¼‰
â€¢ å¯ç”¨è¯¦ç»†é”™è¯¯ä¿¡æ¯
â€¢ é‡ç‚¹å…³æ³¨åŠŸèƒ½å®ç°

æµ‹è¯•ç¯å¢ƒï¼š
â€¢ æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒé…ç½®
â€¢ è¿›è¡Œå®‰å…¨æµ‹è¯•éªŒè¯
â€¢ ä¿ç•™å¿…è¦çš„è°ƒè¯•åŠŸèƒ½
â€¢ éªŒè¯å®‰å…¨æªæ–½æœ‰æ•ˆæ€§

ç”Ÿäº§ç¯å¢ƒï¼š
â€¢ ä¸¥æ ¼æŒ‰ç…§å®‰å…¨æ¸…å•æ‰§è¡Œ
â€¢ å®šæœŸå®‰å…¨å®¡è®¡å’Œæ›´æ–°
â€¢ ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶å®Œå–„
â€¢ åº”æ€¥å“åº”é¢„æ¡ˆå‡†å¤‡
```

**ğŸ›¡ï¸ å®‰å…¨åŠ å›ºå®æ–½æ­¥éª¤**ï¼š
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¸…ç†
1. å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶
2. åˆ é™¤é»˜è®¤åº”ç”¨å’Œç¤ºä¾‹
3. åˆ›å»ºå®‰å…¨çš„é»˜è®¤é¡µé¢
4. éªŒè¯æ¸…ç†æ•ˆæœ

ç¬¬äºŒé˜¶æ®µï¼šæƒé™æ§åˆ¶
1. é…ç½®ç”¨æˆ·è§’è‰²æƒé™
2. è®¾ç½®è®¿é—®æ§åˆ¶ç­–ç•¥
3. é™åˆ¶ç®¡ç†ç•Œé¢è®¿é—®
4. æµ‹è¯•æƒé™é…ç½®

ç¬¬ä¸‰é˜¶æ®µï¼šä¿¡æ¯éšè—
1. ä¿®æ”¹HTTPå“åº”å¤´
2. è‡ªå®šä¹‰é”™è¯¯é¡µé¢
3. éšè—ç‰ˆæœ¬ä¿¡æ¯
4. éªŒè¯éšè—æ•ˆæœ

ç¬¬å››é˜¶æ®µï¼šç›‘æ§å‘Šè­¦
1. é…ç½®è¯¦ç»†è®¿é—®æ—¥å¿—
2. è®¾ç½®ç›‘æ§è„šæœ¬
3. å»ºç«‹å‘Šè­¦æœºåˆ¶
4. å®šæœŸåˆ†ææ—¥å¿—
```

### 8.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**â“ å®‰å…¨åŠ å›ºä¼šå½±å“æ€§èƒ½å—ï¼Ÿ**
```
ç­”ï¼šå½±å“å¾ˆå°ï¼Œä¸»è¦åœ¨äºï¼š
âœ… æƒé™æ£€æŸ¥ï¼šå¾®ç§’çº§å¼€é”€ï¼Œå¯å¿½ç•¥
âœ… è®¿é—®æ—¥å¿—ï¼šI/Oå¼€é”€ï¼Œä½†å¯¹æ€§èƒ½å½±å“ä¸å¤§
âœ… ä¿¡æ¯éšè—ï¼šæ— æ€§èƒ½å½±å“
âš ï¸ æ³¨æ„é¿å…ï¼šè¿‡äºå¤æ‚çš„è®¿é—®æ§åˆ¶é€»è¾‘
```

**â“ å¦‚ä½•å¹³è¡¡å®‰å…¨æ€§å’Œæ˜“ç”¨æ€§ï¼Ÿ**
```
ç­”ï¼šé‡‡ç”¨åˆ†å±‚ç­–ç•¥ï¼š
â€¢ æ ¸å¿ƒç³»ç»Ÿï¼šå®‰å…¨ä¼˜å…ˆï¼Œä¸¥æ ¼æ§åˆ¶
â€¢ å¼€å‘ç¯å¢ƒï¼šæ˜“ç”¨ä¼˜å…ˆï¼Œä¿ç•™è°ƒè¯•åŠŸèƒ½  
â€¢ ç”¨æˆ·ç•Œé¢ï¼šåœ¨å®‰å…¨å‰æä¸‹ä¼˜åŒ–ä½“éªŒ
â€¢ ç®¡ç†å·¥å…·ï¼šæä¾›å®‰å…¨çš„ç®¡ç†æ¥å£
```

**â“ å®‰å…¨é…ç½®è¢«è¯¯åˆ æ€ä¹ˆåŠï¼Ÿ**
```
ç­”ï¼šå»ºç«‹å¤‡ä»½å’Œæ¢å¤æœºåˆ¶ï¼š
1. é…ç½®æ–‡ä»¶å®šæœŸå¤‡ä»½
2. æ–‡æ¡£è®°å½•æ‰€æœ‰é…ç½®å˜æ›´
3. ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®æ–‡ä»¶
4. å»ºç«‹å¿«é€Ÿæ¢å¤æµç¨‹
```

**ğŸ§  å®‰å…¨è®°å¿†è¦ç‚¹**ï¼š
- å®‰å…¨åŠ å›ºéµå¾ªæœ€å°æƒé™å’Œçºµæ·±é˜²å¾¡åŸåˆ™
- åˆ é™¤é»˜è®¤åº”ç”¨ï¼Œç¦ç”¨ç®¡ç†ç•Œé¢ï¼Œéšè—ç‰ˆæœ¬ä¿¡æ¯
- æƒé™æ§åˆ¶è¦ç²¾ç»†åŒ–ï¼Œè®¿é—®æ—¥å¿—è¦è¯¦ç»†åŒ–
- å®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼Œéœ€è¦æŒç»­ç»´æŠ¤ç›‘æ§
- å¹³è¡¡å®‰å…¨ä¸æ˜“ç”¨ï¼Œæ ¹æ®ç¯å¢ƒè°ƒæ•´ç­–ç•¥

**æ ¸å¿ƒç†å¿µ**ï¼šå®‰å…¨åŠ å›ºå°±åƒç»™æˆ¿å­è£…é˜²ç›—ç³»ç»Ÿï¼Œæ—¢è¦é˜²æ­¢å¤–äººå…¥ä¾µï¼Œåˆè¦æ–¹ä¾¿è‡ªå·±ä½¿ç”¨ã€‚å…³é”®æ˜¯å»ºç«‹å®Œæ•´çš„é˜²æŠ¤ä½“ç³»ï¼Œè€Œä¸æ˜¯ä¾èµ–å•ä¸€çš„å®‰å…¨æªæ–½ï¼