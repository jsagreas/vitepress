---
title: 3ã€åˆ†å¸ƒå¼ä¼šè¯ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä¼šè¯é—®é¢˜](#1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä¼šè¯é—®é¢˜)
2. [Sticky Sessionç²˜æ€§ä¼šè¯](#2-sticky-sessionç²˜æ€§ä¼šè¯)
3. [Sessionå…±äº«æ–¹æ¡ˆå¯¹æ¯”](#3-sessionå…±äº«æ–¹æ¡ˆå¯¹æ¯”)
4. [Redisä¼šè¯å­˜å‚¨å®æˆ˜](#4-redisä¼šè¯å­˜å‚¨å®æˆ˜)
5. [æ•°æ®åº“ä¼šè¯å­˜å‚¨](#5-æ•°æ®åº“ä¼šè¯å­˜å‚¨)
6. [ä¼šè¯åŒæ­¥æœºåˆ¶](#6-ä¼šè¯åŒæ­¥æœºåˆ¶)
7. [æ•…éšœæ¢å¤ç­–ç•¥](#7-æ•…éšœæ¢å¤ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤” ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä¼šè¯é—®é¢˜


### 1.1 å•æœºæ—¶ä»£æ²¡æœ‰è¿™ä¸ªé—®é¢˜


æƒ³è±¡ä¸€ä¸‹å¼€é¤å…ï¼Œä»¥å‰åªæœ‰ä¸€ä¸ªæœåŠ¡å‘˜å°æ˜ï¼š

```
å®¢æˆ·å¼ ä¸‰æ¥äº† â†’ å°æ˜è®°ä½ï¼š"å¼ ä¸‰ç‚¹äº†å®«ä¿é¸¡ä¸"
å®¢æˆ·å¼ ä¸‰å†æ¥ â†’ å°æ˜æƒ³èµ·ï¼š"å“¦ï¼Œæ˜¯ç‚¹å®«ä¿é¸¡ä¸çš„å¼ ä¸‰"
```

è¿™å°±æ˜¯ **å•æœºåº”ç”¨**ï¼šä¸€å°æœåŠ¡å™¨è®°ä½æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼ˆSessionï¼‰ï¼Œæ²¡é—®é¢˜ã€‚

### 1.2 å¤šå°æœåŠ¡å™¨å¸¦æ¥çš„é—®é¢˜


ä½†ç”Ÿæ„å¥½äº†ï¼Œé¤å…é›‡äº†3ä¸ªæœåŠ¡å‘˜ï¼šå°æ˜ã€å°çº¢ã€å°æ

```
ç¬¬ä¸€æ¬¡ï¼šå®¢æˆ·å¼ ä¸‰ â†’ å°æ˜æ¥å¾… â†’ å°æ˜è®°ä½"å¼ ä¸‰ç‚¹äº†å®«ä¿é¸¡ä¸"
ç¬¬äºŒæ¬¡ï¼šå®¢æˆ·å¼ ä¸‰ â†’ å°çº¢æ¥å¾… â†’ å°çº¢ä¸è®¤è¯†ï¼š"æ‚¨æ˜¯è°ï¼Ÿç‚¹ä»€ä¹ˆï¼Ÿ"
```

è¿™å°±æ˜¯ **åˆ†å¸ƒå¼ä¼šè¯é—®é¢˜**ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœåŠ¡å™¨A    â”‚    â”‚   æœåŠ¡å™¨B    â”‚    â”‚   æœåŠ¡å™¨C    â”‚
â”‚ Session: {} â”‚    â”‚ Session: {} â”‚    â”‚ Session: {} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘                   â†‘                   â†‘
       â”‚                   â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            è´Ÿè½½å‡è¡¡å™¨                        â”‚
    â”‚     ç”¨æˆ·è¯·æ±‚éšæœºåˆ†é…åˆ°ä¸åŒæœåŠ¡å™¨              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 1.3 ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªé—®é¢˜


**æ ¹æœ¬åŸå› **ï¼š`Sessioné»˜è®¤å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­`

- ç”¨æˆ·ç™»å½•æ—¶ï¼ŒSessionå­˜åœ¨æœåŠ¡å™¨Açš„å†…å­˜é‡Œ
- ä¸‹æ¬¡è¯·æ±‚è¢«åˆ†é…åˆ°æœåŠ¡å™¨Bï¼ŒBçš„å†…å­˜é‡Œæ²¡æœ‰è¿™ä¸ªSession
- ç³»ç»Ÿè®¤ä¸ºç”¨æˆ·æ²¡ç™»å½•ï¼Œè¦æ±‚é‡æ–°ç™»å½•

> ğŸ’¡ **æ–°æ‰‹ç†è§£**ï¼šå°±åƒæ¯ä¸ªæœåŠ¡å‘˜éƒ½æœ‰è‡ªå·±çš„å°æœ¬å­è®°å®¢æˆ·ä¿¡æ¯ï¼Œä½†å°æœ¬å­ä¹‹é—´ä¸å…±äº«

---

## 2. ğŸ¯ Sticky Sessionç²˜æ€§ä¼šè¯


### 2.1 ä»€ä¹ˆæ˜¯ç²˜æ€§ä¼šè¯


**ç²˜æ€§ä¼šè¯**å°±æ˜¯è®©ç”¨æˆ·"ç²˜"åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼š

```
å®¢æˆ·å¼ ä¸‰ç¬¬ä¸€æ¬¡ â†’ åˆ†é…ç»™æœåŠ¡å™¨A â†’ ä»¥åå¼ ä¸‰éƒ½æ‰¾æœåŠ¡å™¨A
å®¢æˆ·æå››ç¬¬ä¸€æ¬¡ â†’ åˆ†é…ç»™æœåŠ¡å™¨B â†’ ä»¥åæå››éƒ½æ‰¾æœåŠ¡å™¨B
å®¢æˆ·ç‹äº”ç¬¬ä¸€æ¬¡ â†’ åˆ†é…ç»™æœåŠ¡å™¨C â†’ ä»¥åç‹äº”éƒ½æ‰¾æœåŠ¡å™¨C
```

### 2.2 Nginxé…ç½®ç²˜æ€§ä¼šè¯


```nginx
upstream backend {
    # ip_hashï¼šæ ¹æ®å®¢æˆ·ç«¯IPåˆ†é…æœåŠ¡å™¨
    ip_hash;
    
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

server {
    listen 80;
    location / {
        proxy_pass http://backend;
    }
}
```

**å·¥ä½œåŸç†**ï¼š
1. ç”¨æˆ·IPï¼š`192.168.1.100` â†’ è®¡ç®—å“ˆå¸Œå€¼ â†’ åˆ†é…ç»™æœåŠ¡å™¨A
2. åŒä¸€IPçš„æ‰€æœ‰è¯·æ±‚éƒ½åˆ†é…ç»™æœåŠ¡å™¨A
3. Sessionå­˜åœ¨æœåŠ¡å™¨Aï¼Œç”¨æˆ·ä½“éªŒæ­£å¸¸

### 2.3 ç²˜æ€§ä¼šè¯çš„ä¼˜ç¼ºç‚¹


| ä¼˜ç‚¹ âœ… | ç¼ºç‚¹ âŒ |
|---------|---------|
| é…ç½®ç®€å• | è´Ÿè½½ä¸å‡è¡¡ |
| æ— éœ€æ”¹ä»£ç  | æœåŠ¡å™¨æ•…éšœå½±å“å¤§ |
| æ€§èƒ½å¥½ | æ‰©å®¹å›°éš¾ |

**ä¸ºä»€ä¹ˆè´Ÿè½½ä¸å‡è¡¡ï¼Ÿ**
- å…¬å¸ç”¨æˆ·éƒ½æ˜¯åŒä¸€ä¸ªå‡ºå£IP â†’ éƒ½åˆ†é…åˆ°ä¸€å°æœåŠ¡å™¨
- å®¶åº­ç”¨æˆ·å¯èƒ½æ¢IP â†’ Sessionä¸¢å¤±

> âš ï¸ **å®é™…é—®é¢˜**ï¼šæŸå°æœåŠ¡å™¨å®•æœºï¼Œè¯¥æœåŠ¡å™¨çš„æ‰€æœ‰ç”¨æˆ·éƒ½éœ€è¦é‡æ–°ç™»å½•

---

## 3. ğŸ“Š Sessionå…±äº«æ–¹æ¡ˆå¯¹æ¯”


### 3.1 å››ç§ä¸»æµæ–¹æ¡ˆ


```
æ–¹æ¡ˆå¯¹æ¯”å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœåŠ¡å™¨A    â”‚  â”‚   æœåŠ¡å™¨B    â”‚  â”‚   æœåŠ¡å™¨C    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Sessionå­˜å‚¨       â”‚
              â”‚  â‘ Redis â‘¡æ•°æ®åº“     â”‚
              â”‚  â‘¢æ–‡ä»¶  â‘£å†…å­˜å¤åˆ¶   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ–¹æ¡ˆè¯¦ç»†å¯¹æ¯”


| æ–¹æ¡ˆç±»å‹ | **å­˜å‚¨ä½ç½®** | **æ€§èƒ½** | **å¯é æ€§** | **å¤æ‚åº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|---------|-------------|------------|-------------|
| ğŸ”´ **Rediså­˜å‚¨** | `å†…å­˜æ•°æ®åº“` | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | `å¤§å‹ç½‘ç«™æ¨è` |
| ğŸ”µ **æ•°æ®åº“å­˜å‚¨** | `å…³ç³»æ•°æ®åº“` | â­â­â­ | â­â­â­â­â­ | â­â­ | `ä¸­å°å‹é¡¹ç›®` |
| ğŸŸ¡ **æ–‡ä»¶å…±äº«** | `å…±äº«æ–‡ä»¶ç³»ç»Ÿ` | â­â­ | â­â­ | â­â­â­â­ | `ç®€å•åœºæ™¯` |
| ğŸŸ  **å†…å­˜å¤åˆ¶** | `æœåŠ¡å™¨é—´åŒæ­¥` | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | `ç‰¹å®šæ¡†æ¶` |

**é€‰æ‹©å»ºè®®**ï¼š
- ğŸ¢ **ä¼ä¸šçº§é¡¹ç›®** â†’ Rediså­˜å‚¨ï¼ˆæ€§èƒ½å¥½ï¼Œç¨³å®šï¼‰
- ğŸ« **å­¦æ ¡é¡¹ç›®** â†’ æ•°æ®åº“å­˜å‚¨ï¼ˆç®€å•å¯é ï¼‰  
- ğŸ  **ä¸ªäººé¡¹ç›®** â†’ Sticky Sessionï¼ˆå¤Ÿç”¨å°±è¡Œï¼‰

---

## 4. âš¡ Redisä¼šè¯å­˜å‚¨å®æˆ˜


### 4.1 ä¸ºä»€ä¹ˆé€‰æ‹©Redis


Rediså°±åƒä¸€ä¸ª **è¶…çº§è®°äº‹æœ¬**ï¼š
- **é€Ÿåº¦å¿«**ï¼šæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œæ¯”æ•°æ®åº“å¿«10å€ä»¥ä¸Š
- **æ”¯æŒè¿‡æœŸ**ï¼šSessionå¯ä»¥è‡ªåŠ¨è¿‡æœŸï¼Œä¸ç”¨æ‰‹åŠ¨æ¸…ç†
- **é›†ç¾¤æ”¯æŒ**ï¼šå¯ä»¥å¤šå°Redisç»„æˆé›†ç¾¤ï¼Œæ›´ç¨³å®š

### 4.2 Spring Bootæ•´åˆRedis Session


**ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–**

```xml
<dependencies>
    <!-- Spring Session Redis -->
    <dependency>
        <groupId>org.springframework.session</groupId>
        <artifactId>spring-session-data-redis</artifactId>
    </dependency>
    
    <!-- Redisè¿æ¥ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>
</dependencies>
```

**ç¬¬äºŒæ­¥ï¼šé…ç½®Redisè¿æ¥**

```properties
# RedisæœåŠ¡å™¨é…ç½®
spring.redis.host=127.0.0.1
spring.redis.port=6379
spring.redis.password=

# Sessioné…ç½®
spring.session.store-type=redis
spring.session.redis.namespace=myapp:session
spring.session.timeout=30m
```

**ç¬¬ä¸‰æ­¥ï¼šå¯ç”¨Sessionå…±äº«**

```java
@Configuration
@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800) // 30åˆ†é’Ÿ
public class SessionConfig {
    
    @Bean
    public RedisConnectionFactory connectionFactory() {
        return new LettuceConnectionFactory("127.0.0.1", 6379);
    }
}
```

### 4.3 Sessionæ“ä½œç¤ºä¾‹


```java
@RestController
public class UserController {
    
    // ç”¨æˆ·ç™»å½•
    @PostMapping("/login")
    public String login(String username, String password, 
                       HttpServletRequest request) {
        
        // éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆçœç•¥éªŒè¯é€»è¾‘ï¼‰
        if ("admin".equals(username) && "123456".equals(password)) {
            
            // ç™»å½•æˆåŠŸï¼Œä¿å­˜åˆ°Session
            HttpSession session = request.getSession();
            session.setAttribute("username", username);
            session.setAttribute("loginTime", new Date());
            
            return "ç™»å½•æˆåŠŸï¼";
        }
        return "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼";
    }
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    @GetMapping("/userinfo")
    public String getUserInfo(HttpServletRequest request) {
        HttpSession session = request.getSession();
        String username = (String) session.getAttribute("username");
        
        if (username != null) {
            return "å½“å‰ç”¨æˆ·ï¼š" + username;
        }
        return "è¯·å…ˆç™»å½•ï¼";
    }
}
```

### 4.4 Redisä¸­çš„Sessionæ•°æ®


ç”¨æˆ·ç™»å½•åï¼ŒRedisä¸­ä¼šå­˜å‚¨ï¼š

```
Redisæ•°æ®ç»“æ„ï¼š
spring:session:sessions:38400000-8cf0-11bd-b23e-10b96e4ef00d
â”œâ”€â”€ sessionAttr:username â†’ "admin" 
â”œâ”€â”€ sessionAttr:loginTime â†’ "2025-09-24 15:30:00"
â”œâ”€â”€ creationTime â†’ 1695537000000
â”œâ”€â”€ maxInactiveInterval â†’ 1800
â””â”€â”€ lastAccessedTime â†’ 1695537000000
```

---

## 5. ğŸ—„ï¸ æ•°æ®åº“ä¼šè¯å­˜å‚¨


### 5.1 æ•°æ®åº“æ–¹æ¡ˆçš„ç‰¹ç‚¹


æŠŠSessionå­˜åˆ°æ•°æ®åº“ï¼Œå°±åƒæŠŠå®¢æˆ·ä¿¡æ¯å†™åœ¨è´¦æœ¬ä¸Šï¼š
- **ä¼˜ç‚¹**ï¼šæ•°æ®å®‰å…¨ï¼Œä¸æ€•æœåŠ¡å™¨é‡å¯
- **ç¼ºç‚¹**ï¼šé€Ÿåº¦æ¯”Redisæ…¢ï¼Œä½†æ¯”æ–‡ä»¶å¿«
- **é€‚åˆ**ï¼šå¯¹æ•°æ®å®‰å…¨è¦æ±‚é«˜ï¼Œè®¿é—®é‡ä¸æ˜¯ç‰¹åˆ«å¤§çš„é¡¹ç›®

### 5.2 åˆ›å»ºSessionè¡¨


```sql
CREATE TABLE sessions (
    session_id VARCHAR(128) NOT NULL PRIMARY KEY,
    session_data TEXT NOT NULL,
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_access_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    max_inactive_interval INT DEFAULT 1800,
    expired_time TIMESTAMP,
    INDEX idx_expired_time (expired_time)
);
```

**å­—æ®µè¯´æ˜**ï¼š
- `session_id`ï¼šSessionçš„å”¯ä¸€æ ‡è¯†
- `session_data`ï¼šåºåˆ—åŒ–åçš„Sessionæ•°æ®  
- `expired_time`ï¼šè¿‡æœŸæ—¶é—´ï¼Œç”¨äºæ¸…ç†è¿‡æœŸSession

### 5.3 Spring Booté…ç½®æ•°æ®åº“Session


```properties
# æ•°æ®åº“é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/myapp
spring.datasource.username=root
spring.datasource.password=123456

# Sessionå­˜å‚¨é…ç½®
spring.session.store-type=jdbc
spring.session.jdbc.initialize-schema=always
spring.session.timeout=30m
```

```java
@Configuration
@EnableJdbcHttpSession(
    tableName = "sessions",           // è¡¨å
    maxInactiveIntervalInSeconds = 1800,  // 30åˆ†é’Ÿ
    cleanupCron = "0 0 * * * *"          // æ¯å°æ—¶æ¸…ç†è¿‡æœŸSession
)
public class JdbcSessionConfig {
    // è‡ªåŠ¨é…ç½®ï¼Œæ— éœ€é¢å¤–ä»£ç 
}
```

### 5.4 å®šæ—¶æ¸…ç†è¿‡æœŸSession


```java
@Component
public class SessionCleanupTask {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    // æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡æ¸…ç†
    @Scheduled(cron = "0 0 * * * *")
    public void cleanupExpiredSessions() {
        String sql = "DELETE FROM sessions WHERE expired_time < NOW()";
        int deleted = jdbcTemplate.update(sql);
        System.out.println("æ¸…ç†è¿‡æœŸSession: " + deleted + " æ¡");
    }
}
```

---

## 6. ğŸ”„ ä¼šè¯åŒæ­¥æœºåˆ¶


### 6.1 ä»€ä¹ˆæ˜¯ä¼šè¯åŒæ­¥


ä¼šè¯åŒæ­¥å°±æ˜¯è®©å¤šå°æœåŠ¡å™¨çš„Sessionæ•°æ®ä¿æŒä¸€è‡´ï¼š

```
ç”¨æˆ·åœ¨æœåŠ¡å™¨Aç™»å½• â†’ SessionåŒæ­¥åˆ° â†’ æœåŠ¡å™¨Bã€Cä¹ŸçŸ¥é“ç”¨æˆ·å·²ç™»å½•
```

### 6.2 åŒæ­¥ç­–ç•¥å¯¹æ¯”


```
åŒæ­¥æ—¶æœºå¯¹æ¯”ï¼š

â‘  å®æ—¶åŒæ­¥ï¼ˆæ¨èï¼‰
ç”¨æˆ·ç™»å½• â†’ ç«‹å³åŒæ­¥åˆ°æ‰€æœ‰æœåŠ¡å™¨
ä¼˜ç‚¹ï¼šæ•°æ®æœ€æ–°  ç¼ºç‚¹ï¼šç½‘ç»œå¼€é”€å¤§

â‘¡ å®šæ—¶åŒæ­¥
æ¯5åˆ†é’ŸåŒæ­¥ä¸€æ¬¡æ‰€æœ‰Sessionå˜åŒ–  
ä¼˜ç‚¹ï¼šç½‘ç»œå¼€é”€å°  ç¼ºç‚¹ï¼šå¯èƒ½æœ‰å»¶è¿Ÿ

â‘¢ æŒ‰éœ€åŒæ­¥  
æœåŠ¡å™¨Béœ€è¦æ—¶æ‰ä»Aè·å–Session
ä¼˜ç‚¹ï¼šèŠ‚çœèµ„æº  ç¼ºç‚¹ï¼šé¦–æ¬¡è®¿é—®æ…¢
```

### 6.3 Redis Clusterè‡ªåŠ¨åŒæ­¥


ä½¿ç”¨Redisé›†ç¾¤ï¼ŒSessionæ•°æ®è‡ªåŠ¨åœ¨å¤šä¸ªRedisèŠ‚ç‚¹é—´åŒæ­¥ï¼š

```
Redisé›†ç¾¤æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis-1  â”‚â—„â”€â”€â–ºâ”‚ Redis-2  â”‚â—„â”€â”€â–ºâ”‚ Redis-3  â”‚  
â”‚ Master   â”‚    â”‚ Master   â”‚    â”‚ Master   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ Redis-4  â”‚    â”‚ Redis-5  â”‚    â”‚ Redis-6  â”‚
â”‚ Slave    â”‚    â”‚ Slave    â”‚    â”‚ Slave    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®Redisé›†ç¾¤Session**ï¼š

```java
@Configuration
public class RedisClusterSessionConfig {
    
    @Bean
    public RedisConnectionFactory redisConnectionFactory() {
        RedisClusterConfiguration config = new RedisClusterConfiguration();
        config.clusterNode("127.0.0.1", 7001);
        config.clusterNode("127.0.0.1", 7002); 
        config.clusterNode("127.0.0.1", 7003);
        
        return new LettuceConnectionFactory(config);
    }
}
```

---

## 7. ğŸ›¡ï¸ æ•…éšœæ¢å¤ç­–ç•¥


### 7.1 å¸¸è§æ•…éšœåœºæ™¯


**åœºæ™¯ä¸€**ï¼šRedisæœåŠ¡å™¨å®•æœº

```
æ•…éšœå‰ï¼šç”¨æˆ· â†’ åº”ç”¨æœåŠ¡å™¨ â†’ Redis â†’ Sessionæ­£å¸¸
æ•…éšœæ—¶ï¼šç”¨æˆ· â†’ åº”ç”¨æœåŠ¡å™¨ â†’ RedisâŒ â†’ è·å–Sessionå¤±è´¥
æ•…éšœåï¼šéœ€è¦æ¢å¤æˆ–åˆ‡æ¢åˆ°å¤‡ç”¨Redis
```

**åœºæ™¯äºŒ**ï¼šåº”ç”¨æœåŠ¡å™¨å®•æœº

```
æ•…éšœå‰ï¼šç”¨æˆ· â†’ è´Ÿè½½å‡è¡¡ â†’ æœåŠ¡å™¨A â†’ Sessionæ­£å¸¸  
æ•…éšœæ—¶ï¼šç”¨æˆ· â†’ è´Ÿè½½å‡è¡¡ â†’ æœåŠ¡å™¨AâŒ â†’ è¯·æ±‚å¤±è´¥
æ•…éšœåï¼šç”¨æˆ· â†’ è´Ÿè½½å‡è¡¡ â†’ æœåŠ¡å™¨B â†’ Sessionä»ç„¶å¯ç”¨ï¼ˆå› ä¸ºå­˜åœ¨Redisï¼‰
```

### 7.2 Redisæ•…éšœæ¢å¤æ–¹æ¡ˆ


**â‘ ä¸»ä»åˆ‡æ¢**ï¼š

```java
@Configuration  
public class RedisFailoverConfig {
    
    @Bean
    public RedisConnectionFactory redisConnectionFactory() {
        // Rediså“¨å…µé…ç½®ï¼Œè‡ªåŠ¨æ•…éšœåˆ‡æ¢
        RedisSentinelConfiguration config = new RedisSentinelConfiguration()
            .master("mymaster")
            .sentinel("127.0.0.1", 26379)
            .sentinel("127.0.0.1", 26380);
            
        return new LettuceConnectionFactory(config);
    }
}
```

**â‘¡é™çº§ç­–ç•¥**ï¼š

```java
@Component
public class SessionFallbackHandler {
    
    @Autowired  
    private RedisTemplate redisTemplate;
    
    public void saveSession(String sessionId, Object data) {
        try {
            // ä¼˜å…ˆä½¿ç”¨Redis
            redisTemplate.opsForValue().set(sessionId, data);
        } catch (Exception e) {
            // Redisæ•…éšœæ—¶é™çº§åˆ°æ•°æ®åº“
            saveToDatabase(sessionId, data);
        }
    }
    
    private void saveToDatabase(String sessionId, Object data) {
        // æ•°æ®åº“å¤‡ä»½æ–¹æ¡ˆ
    }
}
```

### 7.3 ä¼šè¯ä¸¢å¤±å¤„ç†


**ç”¨æˆ·å‹å¥½çš„å¤„ç†æ–¹å¼**ï¼š

```java
@Component
public class SessionLostHandler {
    
    // æ£€æµ‹Sessionæ˜¯å¦ä¸¢å¤±
    public boolean isSessionLost(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        return session == null || session.getAttribute("username") == null;
    }
    
    // å‹å¥½æç¤ºç”¨æˆ·é‡æ–°ç™»å½•
    @ExceptionHandler(SessionLostException.class)
    public String handleSessionLost() {
        return "æ‚¨çš„ç™»å½•çŠ¶æ€å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•";
    }
}
```

### 7.4 ç›‘æ§ä¸æŠ¥è­¦


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

| ç›‘æ§é¡¹ç›® | **æ­£å¸¸å€¼** | **æŠ¥è­¦æ¡ä»¶** | **å¤„ç†æ–¹å¼** |
|---------|------------|-------------|------------|
| Redisè¿æ¥æ•° | `< 1000` | `> 5000` | æ‰©å®¹æˆ–ä¼˜åŒ–è¿æ¥æ±  |
| Sessionæ•°é‡ | `< 10ä¸‡` | `> 50ä¸‡` | æ¸…ç†è¿‡æœŸSession |  
| å“åº”æ—¶é—´ | `< 100ms` | `> 500ms` | æ£€æŸ¥ç½‘ç»œå’ŒRedis |
| é”™è¯¯ç‡ | `< 0.1%` | `> 1%` | æ£€æŸ¥æ•…éšœåŸå›  |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ åˆ†å¸ƒå¼ä¼šè¯é—®é¢˜ï¼šå¤šæœåŠ¡å™¨å¯¼è‡´Sessionæ— æ³•å…±äº«
ğŸ”¸ ç²˜æ€§ä¼šè¯ï¼šç”¨æˆ·å›ºå®šè®¿é—®ä¸€å°æœåŠ¡å™¨ï¼Œç®€å•ä½†æœ‰å±€é™  
ğŸ”¸ Sessionå…±äº«ï¼šé€šè¿‡å¤–éƒ¨å­˜å‚¨å®ç°Sessionåœ¨æœåŠ¡å™¨é—´å…±äº«
ğŸ”¸ Rediså­˜å‚¨ï¼šé«˜æ€§èƒ½çš„Sessionå…±äº«æ–¹æ¡ˆï¼Œä¼ä¸šå¸¸ç”¨
ğŸ”¸ æ•°æ®åº“å­˜å‚¨ï¼šå¯é çš„Sessionå­˜å‚¨æ–¹æ¡ˆï¼Œé€‚åˆä¸­å°é¡¹ç›®
ğŸ”¸ æ•…éšœæ¢å¤ï¼šä¿è¯ç³»ç»Ÿé«˜å¯ç”¨çš„é‡è¦æœºåˆ¶
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼ä¼šè¯ç®¡ç†**
```
æœ¬è´¨é—®é¢˜ï¼š
- å•æœºæ—¶ä»£Sessionå­˜æœ¬åœ°å†…å­˜ï¼Œæ²¡é—®é¢˜
- å¤šæœºæ—¶ä»£éœ€è¦Sessionåœ¨æœåŠ¡å™¨é—´å…±äº«
- ç”¨æˆ·ä½“éªŒï¼šä¸èƒ½å› ä¸ºè®¿é—®äº†ä¸åŒæœåŠ¡å™¨å°±è¦é‡æ–°ç™»å½•

è§£å†³æ€è·¯ï¼š
- è¦ä¹ˆç”¨æˆ·å›ºå®šè®¿é—®ä¸€å°æœåŠ¡å™¨ï¼ˆç²˜æ€§ï¼‰
- è¦ä¹ˆSessionæ•°æ®åœ¨æœåŠ¡å™¨é—´å…±äº«ï¼ˆå­˜å‚¨ï¼‰
```

**ğŸ”¹ å„ç§æ–¹æ¡ˆçš„é€‰æ‹©åŸåˆ™**
```
æŠ€æœ¯é€‰æ‹©è€ƒè™‘å› ç´ ï¼š
- é¡¹ç›®è§„æ¨¡ï¼šä¸ªäººé¡¹ç›® vs ä¼ä¸šé¡¹ç›®
- æ€§èƒ½è¦æ±‚ï¼šå“åº”æ—¶é—´è¦æ±‚
- å¯é æ€§è¦æ±‚ï¼šèƒ½å¦æ¥å—å¶å°”é‡æ–°ç™»å½•
- æŠ€æœ¯å›¢é˜Ÿï¼šç»´æŠ¤èƒ½åŠ›

æ¨èç»„åˆï¼š
- å°é¡¹ç›®ï¼šSticky Session + æ•°æ®åº“å¤‡ä»½
- å¤§é¡¹ç›®ï¼šRedisé›†ç¾¤ + æ•…éšœåˆ‡æ¢
- è¶…å¤§é¡¹ç›®ï¼šåˆ†å±‚ç¼“å­˜ + å¤šé‡å¤‡ä»½
```

**ğŸ”¹ Sessionå®‰å…¨æ³¨æ„äº‹é¡¹**
```
å®‰å…¨è€ƒè™‘ï¼š
- Session IDè¦è¶³å¤Ÿå¤æ‚ï¼Œé˜²æ­¢è¢«çŒœæµ‹
- é‡è¦æ“ä½œå‰é‡æ–°éªŒè¯èº«ä»½
- åŠæ—¶æ¸…ç†è¿‡æœŸSessionï¼Œé˜²æ­¢å†…å­˜æ³„éœ²
- æ•æ„Ÿæ•°æ®ä¸è¦ç›´æ¥æ”¾Sessionï¼Œç”¨IDå…³è”

æ€§èƒ½ä¼˜åŒ–ï¼š
- æ§åˆ¶Sessionå¤§å°ï¼Œä¸å­˜å‚¨å¤§å¯¹è±¡
- åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´
- ä½¿ç”¨è¿æ¥æ± å‡å°‘Redisè¿æ¥å¼€é”€
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¼ä¸šå¼€å‘åœºæ™¯**ï¼š
- **ç”µå•†ç½‘ç«™**ï¼šç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ä¿¡æ¯è·¨æœåŠ¡å™¨è®¿é—®
- **åŠå…¬ç³»ç»Ÿ**ï¼šå‘˜å·¥ç™»å½•çŠ¶æ€åœ¨å¤šä¸ªä¸šåŠ¡æ¨¡å—é—´å…±äº«  
- **ç¤¾äº¤åº”ç”¨**ï¼šç”¨æˆ·ä¼šè¯ä¿¡æ¯åœ¨èŠå¤©ã€æœ‹å‹åœˆç­‰åŠŸèƒ½é—´åŒæ­¥
- **åœ¨çº¿æ•™è‚²**ï¼šå­¦ç”Ÿç™»å½•çŠ¶æ€åœ¨è§†é¢‘ã€ä½œä¸šã€è€ƒè¯•ç³»ç»Ÿé—´å…±äº«

**ğŸ¯ è§£å†³çš„å®é™…é—®é¢˜**ï¼š
- ç”¨æˆ·ä¸éœ€è¦é‡å¤ç™»å½•ï¼Œæå‡ä½“éªŒ
- ç³»ç»Ÿå¯ä»¥æ°´å¹³æ‰©å±•ï¼Œæ”¯æŒæ›´å¤šç”¨æˆ·
- æœåŠ¡å™¨æ•…éšœä¸å½±å“ç”¨æˆ·ä½¿ç”¨
- ä¾¿äºç³»ç»Ÿç›‘æ§å’Œè¿ç»´ç®¡ç†

**ğŸ”§ è¿ç»´å®è·µä»·å€¼**ï¼š
- æœåŠ¡å™¨æ‰©å®¹æ—¶ç”¨æˆ·æ— æ„ŸçŸ¥
- æ•…éšœåˆ‡æ¢æ—¶æœ€å°åŒ–ç”¨æˆ·å½±å“  
- ä¾¿äºç³»ç»Ÿæ€§èƒ½è°ƒä¼˜å’Œé—®é¢˜æ’æŸ¥
- æ”¯æŒç°åº¦å‘å¸ƒå’ŒA/Bæµ‹è¯•

### 8.4 å­¦ä¹ å»ºè®®


**ğŸ“š å­¦ä¹ è·¯å¾„**ï¼š
1. **ç†è§£æ¦‚å¿µ**ï¼šå…ˆææ¸…æ¥šä¸ºä»€ä¹ˆéœ€è¦Sessionç®¡ç†
2. **åŠ¨æ‰‹å®è·µ**ï¼šä»ç®€å•çš„Sticky Sessionå¼€å§‹
3. **è¿›é˜¶åº”ç”¨**ï¼šæŒæ¡Redis Sessionçš„é…ç½®å’Œä½¿ç”¨
4. **æ·±å…¥ç†è§£**ï¼šå­¦ä¹ æ•…éšœå¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–
5. **ä¼ä¸šå®æˆ˜**ï¼šäº†è§£å¤§å‹é¡¹ç›®çš„å®é™…æ–¹æ¡ˆ

**ğŸ’¡ å®è·µå»ºè®®**ï¼š
- æœ¬åœ°æ­å»ºå¤šä¸ªSpring Bootåº”ç”¨æµ‹è¯•Sessionå…±äº«
- ä½¿ç”¨Redis Desktop ManageræŸ¥çœ‹Sessionæ•°æ®ç»“æ„
- æ¨¡æ‹ŸæœåŠ¡å™¨å®•æœºæµ‹è¯•æ•…éšœæ¢å¤
- ç›‘æ§Sessionæ•°é‡å’Œå“åº”æ—¶é—´å˜åŒ–

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å¤šæœåŠ¡å™¨Sessionè¦å…±äº«ï¼ŒRediså­˜å‚¨æ˜¯é¦–é€‰
- ç²˜æ€§ä¼šè¯é…ç½®ç®€ï¼Œæ•…éšœå½±å“è¦è€ƒè™‘  
- æ•°æ®åº“æ–¹æ¡ˆæ›´å¯é ï¼Œæ€§èƒ½ç¨é€Šä½†å¤Ÿç”¨
- æ•…éšœæ¢å¤è¦é¢„æ¡ˆï¼Œç”¨æˆ·ä½“éªŒç¬¬ä¸€çº¿