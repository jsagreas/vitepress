---
title: 3、请求响应处理
---
## 📚 目录

1. [JSP请求响应概述](#1-JSP请求响应概述)
2. [请求参数获取详解](#2-请求参数获取详解)
3. [请求头信息处理](#3-请求头信息处理)
4. [响应设置与编码](#4-响应设置与编码)
5. [请求转发vs重定向](#5-请求转发vs重定向)
6. [中文乱码问题解决](#6-中文乱码问题解决)
7. [实际应用场景](#7-实际应用场景)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌐 JSP请求响应概述


### 1.1 什么是请求响应


**通俗理解**：就像你去餐厅点餐一样
```
你（客户端）对服务员（服务器）说：我要一份宫保鸡丁（发送请求）
服务员记录你的需求，然后上菜给你（发送响应）

Web中的请求响应：
用户在浏览器输入网址或点击按钮（发送请求）
服务器处理请求，返回网页内容（发送响应）
```

**核心概念**：
- **request（请求）**：浏览器向服务器发送的信息包，包含用户的需求和数据
- **response（响应）**：服务器向浏览器返回的信息包，包含处理结果和网页内容

### 1.2 请求响应的基本流程


```
浏览器                    JSP服务器
   |                         |
   |--[1]发送HTTP请求-------->|
   |   (包含表单数据等)        |
   |                         |
   |                         |--[2]JSP处理请求
   |                         |   获取参数、处理业务
   |                         |
   |<--[3]返回HTTP响应--------|
   |   (HTML页面内容)         |
```

### 1.3 JSP中的内置对象


JSP提供了现成的对象来处理请求响应，不需要我们自己创建：

| 对象名 | **作用** | **通俗解释** |
|--------|----------|-------------|
| `request` | 获取用户请求信息 | 就像服务员记录的点餐单 |
| `response` | 设置返回给用户的响应 | 就像厨师准备的菜品 |
| `session` | 存储用户会话信息 | 就像餐厅记住你的用餐偏好 |
| `application` | 存储全局应用信息 | 就像餐厅的菜单和规则 |

---

## 2. 📝 请求参数获取详解


### 2.1 getParameter方法 - 获取单个参数


**作用**：获取表单中单个输入框的值

```jsp
<%
// 假设HTML表单中有：<input name="username" value="张三">
String username = request.getParameter("username");
out.print("用户名：" + username);  // 输出：用户名：张三
%>
```

**重要特点**：
- 🔸 如果参数不存在，返回 `null`
- 🔸 如果参数值为空，返回 `""`（空字符串）
- 🔸 参数名区分大小写

**安全使用方式**：
```jsp
<%
String username = request.getParameter("username");
if (username != null && !username.trim().isEmpty()) {
    out.print("欢迎：" + username);
} else {
    out.print("请输入用户名");
}
%>
```

### 2.2 getParameterValues方法 - 获取多个同名参数


**使用场景**：复选框、多选下拉框等有多个相同name的情况

**HTML示例**：
```html
<input type="checkbox" name="hobby" value="读书">读书
<input type="checkbox" name="hobby" value="游戏">游戏  
<input type="checkbox" name="hobby" value="运动">运动
```

**JSP处理**：
```jsp
<%
String[] hobbies = request.getParameterValues("hobby");
if (hobbies != null) {
    out.print("你的爱好有：");
    for (String hobby : hobbies) {
        out.print(hobby + " ");
    }
} else {
    out.print("你没有选择爱好");
}
%>
```

### 2.3 常见的参数获取场景


**📋 表单提交场景对比**

| 表单类型 | **HTML代码** | **JSP获取方式** | **注意事项** |
|----------|-------------|----------------|-------------|
| 文本框 | `<input name="name">` | `getParameter("name")` | 可能为null或空 |
| 单选按钮 | `<input type="radio" name="sex">` | `getParameter("sex")` | 未选择时为null |
| 复选框(单个) | `<input type="checkbox" name="agree">` | `getParameter("agree")` | 未选中为null，选中为value值 |
| 复选框(多个) | `<input type="checkbox" name="hobby">` | `getParameterValues("hobby")` | 返回字符串数组 |
| 下拉框 | `<select name="city">` | `getParameter("city")` | 获取选中的option的value |

---

## 3. 📋 请求头信息处理


### 3.1 什么是请求头


**通俗解释**：请求头就像信封上的邮戳和标签，告诉服务器这个请求的详细信息

```
请求头包含的信息：
• 浏览器类型（我用的是Chrome还是Firefox）
• 操作系统（我用的是Windows还是Mac）
• 可接受的内容类型（我能处理HTML、图片等哪些格式）
• 来源页面（我是从哪个页面跳转过来的）
• 语言偏好（我希望看到中文还是英文）
```

### 3.2 常用请求头获取方法


```jsp
<%
// 获取用户的浏览器信息
String userAgent = request.getHeader("User-Agent");
out.println("你使用的浏览器：" + userAgent + "<br>");

// 获取来源页面
String referer = request.getHeader("Referer");  
out.println("你从哪里来的：" + referer + "<br>");

// 获取客户端IP地址
String clientIP = request.getRemoteAddr();
out.println("你的IP地址：" + clientIP + "<br>");
%>
```

### 3.3 实用的请求信息获取


**🔍 获取详细的请求信息**

```jsp
<%
out.println("<h3>请求详细信息</h3>");
out.println("请求方法：" + request.getMethod() + "<br>");        // GET 或 POST
out.println("请求URL：" + request.getRequestURL() + "<br>");      // 完整URL
out.println("服务器名：" + request.getServerName() + "<br>");     // 域名
out.println("服务器端口：" + request.getServerPort() + "<br>");   // 端口号
out.println("项目路径：" + request.getContextPath() + "<br>");    // 项目根路径
%>
```

---

## 4. ⚙️ 响应设置与编码


### 4.1 setContentType - 设置响应内容类型


**作用**：告诉浏览器返回的内容是什么格式，浏览器好知道怎么处理

```jsp
<%
// 返回HTML页面（最常用）
response.setContentType("text/html;charset=UTF-8");

// 返回纯文本
response.setContentType("text/plain;charset=UTF-8");

// 返回JSON数据（AJAX常用）
response.setContentType("application/json;charset=UTF-8");

// 返回图片
response.setContentType("image/jpeg");
%>
```

**💡 重要提醒**：
- ✅ 必须在输出任何内容之前设置
- ✅ charset=UTF-8 可以避免中文乱码
- ❌ 如果已经输出内容再设置，会失效

### 4.2 setCharacterEncoding - 设置字符编码


```jsp
<%
// 设置响应的字符编码
response.setCharacterEncoding("UTF-8");

// 或者直接在ContentType中指定（推荐）
response.setContentType("text/html;charset=UTF-8");
%>
```

### 4.3 响应头设置示例


```jsp
<%
// 禁用浏览器缓存（适合动态数据）
response.setHeader("Cache-Control", "no-cache");
response.setHeader("Pragma", "no-cache");
response.setDateHeader("Expires", 0);

// 设置下载文件（浏览器会弹出下载对话框）
response.setHeader("Content-Disposition", "attachment; filename=data.txt");
%>
```

---

## 5. 🔄 请求转发vs重定向


### 5.1 概念对比


**通俗理解**：

```
请求转发 = 内部调用
你去银行办事，柜员说"稍等"，然后叫来经理帮你处理
你始终在原来的窗口，地址没变，但处理人换了

重定向 = 换地方办事  
你去银行办事，柜员说"这个业务要到隔壁营业厅办理"
你需要走出去，到新地址重新办理
```

### 5.2 请求转发（forward）


**特点**：
- 🔸 地址栏不变，还是原来的URL
- 🔸 只有一次请求，服务器内部处理
- 🔸 可以共享request数据
- 🔸 用户看不到内部跳转过程

```jsp
<%-- 页面A：处理登录，然后转发到欢迎页面 --%>
<%
String username = request.getParameter("username");
if ("admin".equals(username)) {
    // 在request中存储数据，转发后可以获取
    request.setAttribute("message", "登录成功！");
    // 转发到欢迎页面
    request.getRequestDispatcher("welcome.jsp").forward(request, response);
} else {
    out.print("用户名错误");
}
%>
```

```jsp
<%-- welcome.jsp：欢迎页面 --%>
<%
// 可以获取到转发前存储的数据
String message = (String) request.getAttribute("message");
out.print(message);  // 输出：登录成功！
%>
```

### 5.3 重定向（redirect）


**特点**：
- 🔸 地址栏会变成新的URL
- 🔸 有两次请求，浏览器重新发起请求
- 🔸 不能共享request数据
- 🔸 用户能看到地址变化

```jsp
<%-- 页面A：处理后重定向 --%>
<%
String username = request.getParameter("username");
if ("admin".equals(username)) {
    // 重定向到欢迎页面（地址栏会变）
    response.sendRedirect("welcome.jsp");
} else {
    out.print("用户名错误");
}
%>
```

### 5.4 选择使用场景


| 场景 | **使用方式** | **原因** |
|------|-------------|---------|
| 表单提交后显示结果 | 请求转发 | 保持原URL，共享数据 |
| 登录成功跳转主页 | 重定向 | 改变URL，防止刷新重复提交 |
| 错误页面跳转 | 请求转发 | 保持错误信息，用户体验好 |
| 支付完成跳转 | 重定向 | 防止刷新重复支付 |

---

## 6. 🔧 中文乱码问题解决


### 6.1 乱码产生的原因


**通俗解释**：就像两个人说不同的语言
```
浏览器说：我发给你的中文用的是UTF-8编码
服务器说：我以为你用的是GBK编码，我按GBK来解读
结果：服务器理解错了，中文就变成乱码了
```

### 6.2 POST请求乱码解决


```jsp
<%-- 必须在获取任何参数之前设置 --%>
<%
// 设置请求编码格式
request.setCharacterEncoding("UTF-8");

// 然后再获取参数
String name = request.getParameter("name");
out.print("姓名：" + name);  // 中文正常显示
%>
```

### 6.3 GET请求乱码解决


**方法一：服务器配置（推荐）**
在Tomcat的server.xml中配置：
```xml
<Connector port="8080" 
           URIEncoding="UTF-8" 
           useBodyEncodingForURI="true"/>
```

**方法二：手动转码（临时方案）**
```jsp
<%
String name = request.getParameter("name");
if (name != null) {
    // 手动转换编码
    name = new String(name.getBytes("ISO-8859-1"), "UTF-8");
}
out.print("姓名：" + name);
%>
```

### 6.4 响应乱码解决


```jsp
<%-- 页面顶部设置编码 --%>
<%@ page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8" %>

<%
// 或者在代码中设置
response.setContentType("text/html;charset=UTF-8");
response.setCharacterEncoding("UTF-8");

out.print("你好世界");  // 中文正常显示
%>
```

### 6.5 完整的乱码防护方案


```jsp
<%@ page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>中文测试</title>
</head>
<body>
<%
// 1. 设置请求编码
request.setCharacterEncoding("UTF-8");

// 2. 设置响应编码
response.setContentType("text/html;charset=UTF-8");

// 3. 获取参数
String message = request.getParameter("message");
if (message != null) {
    out.print("收到消息：" + message);
} else {
    out.print("没有收到消息");
}
%>
</body>
</html>
```

---

## 7. 🚀 实际应用场景


### 7.1 用户注册表单处理


```jsp
<%-- register.jsp：注册页面 --%>
<%@ page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>用户注册</title>
</head>
<body>
    <h2>用户注册</h2>
    <form action="registerProcess.jsp" method="post">
        用户名：<input type="text" name="username" required><br><br>
        密码：<input type="password" name="password" required><br><br>
        邮箱：<input type="email" name="email"><br><br>
        爱好：
        <input type="checkbox" name="hobby" value="读书">读书
        <input type="checkbox" name="hobby" value="运动">运动
        <input type="checkbox" name="hobby" value="音乐">音乐<br><br>
        <input type="submit" value="注册">
    </form>
</body>
</html>
```

```jsp
<%-- registerProcess.jsp：处理注册 --%>
<%@ page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8" %>
<%
request.setCharacterEncoding("UTF-8");

// 获取表单数据
String username = request.getParameter("username");
String password = request.getParameter("password");
String email = request.getParameter("email");
String[] hobbies = request.getParameterValues("hobby");

// 简单验证
boolean isValid = true;
String errorMsg = "";

if (username == null || username.trim().isEmpty()) {
    isValid = false;
    errorMsg += "用户名不能为空<br>";
}

if (password == null || password.length() < 6) {
    isValid = false;
    errorMsg += "密码长度至少6位<br>";
}

if (isValid) {
    // 注册成功，存储信息并跳转
    session.setAttribute("currentUser", username);
    request.setAttribute("successMsg", "注册成功！欢迎 " + username);
    request.getRequestDispatcher("welcome.jsp").forward(request, response);
} else {
    // 注册失败，显示错误信息
    request.setAttribute("errorMsg", errorMsg);
    request.getRequestDispatcher("register.jsp").forward(request, response);
}
%>
```

### 7.2 简单的登录验证


```jsp
<%-- login.jsp：登录处理 --%>
<%@ page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8" %>
<%
request.setCharacterEncoding("UTF-8");

String username = request.getParameter("username");
String password = request.getParameter("password");

// 简单的用户验证（实际项目中应该查询数据库）
if ("admin".equals(username) && "123456".equals(password)) {
    // 登录成功
    session.setAttribute("loginUser", username);
    session.setAttribute("loginTime", new java.util.Date());
    
    // 重定向到主页（防止刷新重复提交）
    response.sendRedirect("main.jsp");
} else {
    // 登录失败，转发回登录页面
    request.setAttribute("errorMsg", "用户名或密码错误！");
    request.getRequestDispatcher("loginForm.jsp").forward(request, response);
}
%>
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心方法


```
🔸 请求参数获取：
  • getParameter(name) - 获取单个参数
  • getParameterValues(name) - 获取多个同名参数
  • 注意null值判断和空字符串处理

🔸 响应设置：
  • setContentType() - 设置内容类型和编码
  • setCharacterEncoding() - 设置字符编码
  • 必须在输出内容前设置

🔸 页面跳转：
  • forward() - 请求转发，地址不变，可共享数据
  • sendRedirect() - 重定向，地址改变，防止重复提交
```

### 8.2 重要理解要点


**🔹 参数获取的安全处理**
```
永远要检查参数是否为null：
String name = request.getParameter("name");
if (name != null && !name.trim().isEmpty()) {
    // 安全处理
}
```

**🔹 编码问题的根本解决**
```
三步走策略：
1. 页面声明：<%@ page contentType="text/html;charset=UTF-8" %>
2. 请求编码：request.setCharacterEncoding("UTF-8");
3. 响应编码：response.setContentType("text/html;charset=UTF-8");
```

**🔹 转发vs重定向的选择**
```
表单处理场景：
• 显示处理结果 → 用转发（forward）
• 跳转到新功能 → 用重定向（redirect）
• 防止重复提交 → 用重定向
```

### 8.3 实际开发建议


**💡 最佳实践**
- **参数验证**：永远不要相信用户输入，做好验证和过滤
- **编码统一**：项目中统一使用UTF-8编码
- **错误处理**：提供友好的错误提示信息
- **安全考虑**：避免直接输出用户输入，防止XSS攻击

**⚠️ 常见陷阱**
- 忘记设置请求编码导致中文乱码
- 在输出内容后设置ContentType导致设置失效
- 转发和重定向使用场景搞混
- 没有检查参数null值导致程序异常

**🔧 调试技巧**
- 使用浏览器开发者工具查看请求头和响应头
- 在JSP中临时输出参数值进行调试
- 注意查看服务器日志中的编码相关错误信息

**核心记忆**：
- 请求响应是Web交互的基础，就像问答对话
- 参数获取要安全，编码设置要及时
- 转发重定向有区别，根据场景来选择
- 中文乱码三步解决，UTF-8编码最稳妥