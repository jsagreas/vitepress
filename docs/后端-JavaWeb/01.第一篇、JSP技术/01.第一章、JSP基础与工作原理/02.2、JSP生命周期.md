---
title: 2ã€JSPç”Ÿå‘½å‘¨æœŸ
---
## ğŸ“š ç›®å½•

1. [JSPç”Ÿå‘½å‘¨æœŸæ¦‚è¿°](#1-JSPç”Ÿå‘½å‘¨æœŸæ¦‚è¿°)
2. [ç”Ÿå‘½å‘¨æœŸè¯¦ç»†é˜¶æ®µ](#2-ç”Ÿå‘½å‘¨æœŸè¯¦ç»†é˜¶æ®µ)
3. [ä¸‰å¤§æ ¸å¿ƒæ–¹æ³•è¯¦è§£](#3-ä¸‰å¤§æ ¸å¿ƒæ–¹æ³•è¯¦è§£)
4. [JSPç¼–è¯‘æˆServletçš„è¿‡ç¨‹](#4-JSPç¼–è¯‘æˆServletçš„è¿‡ç¨‹)
5. [ç”Ÿå‘½å‘¨æœŸå®è·µç†è§£](#5-ç”Ÿå‘½å‘¨æœŸå®è·µç†è§£)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ JSPç”Ÿå‘½å‘¨æœŸæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯JSPç”Ÿå‘½å‘¨æœŸ


**é€šä¿—è§£é‡Š**ï¼šå°±åƒäººæœ‰å‡ºç”Ÿã€æˆé•¿ã€å·¥ä½œã€æ­»äº¡çš„ç”Ÿå‘½è¿‡ç¨‹ä¸€æ ·ï¼ŒJSPé¡µé¢ä¹Ÿæœ‰è‡ªå·±çš„"ç”Ÿå‘½å†ç¨‹"ã€‚

```
ç®€å•ç†è§£ï¼šJSPç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸€ä¸ªJSPé¡µé¢ä»è¢«åˆ›å»ºåˆ°è¢«é”€æ¯çš„å®Œæ•´è¿‡ç¨‹
```

**ğŸ”¸ ä¸ºä»€ä¹ˆè¦äº†è§£ç”Ÿå‘½å‘¨æœŸï¼Ÿ**
- å¸®åŠ©ç†è§£JSPçš„**å·¥ä½œæœºåˆ¶**
- çŸ¥é“ä»€ä¹ˆæ—¶å€™è¯¥åšä»€ä¹ˆäº‹æƒ…
- é¿å…åœ¨é”™è¯¯çš„æ—¶æœºæ‰§è¡Œé”™è¯¯çš„æ“ä½œ
- ä¼˜åŒ–é¡µé¢æ€§èƒ½å’Œèµ„æºç®¡ç†

### 1.2 ç”Ÿå‘½å‘¨æœŸå…¨è²Œå›¾ç¤º


```
ç”¨æˆ·è¯·æ±‚JSPé¡µé¢çš„å®Œæ•´æµç¨‹ï¼š

æµè§ˆå™¨è¯·æ±‚ â†’ JSPå®¹å™¨æ£€æŸ¥ â†’ ç”Ÿå‘½å‘¨æœŸå¼€å§‹
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                JSPç”Ÿå‘½å‘¨æœŸ                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ç¿»è¯‘ â”‚â†’ â”‚ç¼–è¯‘ â”‚â†’ â”‚åŠ è½½ â”‚â†’ â”‚åˆå§‹åŒ–â”‚â†’ â”‚å¤„ç†è¯·æ±‚â”‚    â”‚
â”‚  â”‚é˜¶æ®µ â”‚  â”‚é˜¶æ®µ â”‚  â”‚é˜¶æ®µ â”‚  â”‚é˜¶æ®µ â”‚  â”‚é˜¶æ®µ   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â†“        â†“        â†“        â†“        â†“       â”‚
â”‚  .jspâ†’   .javaâ†’   .classâ†’  _jspInit() _jspService()â”‚
â”‚  .java   .class   å†…å­˜åŠ è½½    æ–¹æ³•      æ–¹æ³•        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æœ€ç»ˆé”€æ¯ï¼š_jspDestroy()æ–¹æ³•è¢«è°ƒç”¨
```

**æ ¸å¿ƒç†è§£**ï¼š
- JSPæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**ç‰¹æ®Šçš„Servlet**
- ç”Ÿå‘½å‘¨æœŸç®¡ç†ç”±**JSPå®¹å™¨**ï¼ˆå¦‚Tomcatï¼‰è´Ÿè´£
- å¼€å‘è€…ä¸»è¦å…³æ³¨**ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•**

---

## 2. ğŸ“‹ ç”Ÿå‘½å‘¨æœŸè¯¦ç»†é˜¶æ®µ


### 2.1 ç¬¬ä¸€é˜¶æ®µï¼šç¿»è¯‘ï¼ˆTranslationï¼‰â­â­â­


**è¿™ä¸ªé˜¶æ®µåœ¨å¹²ä»€ä¹ˆï¼Ÿ**
> JSPå®¹å™¨æŠŠä½ å†™çš„`.jsp`æ–‡ä»¶ç¿»è¯‘æˆ`.java`æ–‡ä»¶ï¼ˆServletæºç ï¼‰

```
ç¿»è¯‘è¿‡ç¨‹ç¤ºä¾‹ï¼š

ä½ å†™çš„JSPæ–‡ä»¶ï¼šindex.jsp
<%@ page language="java" %>
<html>
<body>
    <h1>Hello World!</h1>
    <%= new Date() %>
</body>
</html>

â†“ ç¿»è¯‘åç”Ÿæˆï¼šindex_jsp.java
public class index_jsp extends HttpServlet {
    public void _jspService(HttpServletRequest request, 
                           HttpServletResponse response) {
        out.write("<html>");
        out.write("<body>");
        out.write("<h1>Hello World!</h1>");
        out.write(new Date().toString());
        out.write("</body>");
        out.write("</html>");
    }
}
```

**ğŸ”¸ ç¿»è¯‘é˜¶æ®µçš„ç‰¹ç‚¹**ï¼š
- **è§¦å‘æ—¶æœº**ï¼šç¬¬ä¸€æ¬¡è¯·æ±‚JSPé¡µé¢æ—¶
- **ç¿»è¯‘ä½ç½®**ï¼šé€šå¸¸åœ¨`Tomcat/work/Catalina/localhost/é¡¹ç›®å/`ç›®å½•
- **åªæ‰§è¡Œä¸€æ¬¡**ï¼šé™¤éJSPæ–‡ä»¶è¢«ä¿®æ”¹
- **è‡ªåŠ¨è¿›è¡Œ**ï¼šå¼€å‘è€…æ— éœ€æ‰‹åŠ¨æ“ä½œ

### 2.2 ç¬¬äºŒé˜¶æ®µï¼šç¼–è¯‘ï¼ˆCompilationï¼‰â­â­â­


**è¿™ä¸ªé˜¶æ®µåœ¨å¹²ä»€ä¹ˆï¼Ÿ**
> æŠŠç¿»è¯‘ç”Ÿæˆçš„`.java`æ–‡ä»¶ç¼–è¯‘æˆ`.class`å­—èŠ‚ç æ–‡ä»¶

```
ç¼–è¯‘è¿‡ç¨‹ï¼š
index_jsp.java â†’ index_jsp.class

å°±åƒæ™®é€šJavaæ–‡ä»¶çš„ç¼–è¯‘è¿‡ç¨‹ä¸€æ ·ï¼
```

**ğŸ”¸ ç¼–è¯‘é˜¶æ®µçš„ç‰¹ç‚¹**ï¼š
- **ç´§è·Ÿç¿»è¯‘**ï¼šç¿»è¯‘å®Œç«‹å³è¿›è¡Œç¼–è¯‘
- **ç”Ÿæˆå­—èŠ‚ç **ï¼šäº§ç”Ÿå¯æ‰§è¡Œçš„`.class`æ–‡ä»¶
- **æ£€æŸ¥è¯­æ³•**ï¼šç¼–è¯‘æ—¶ä¼šæ£€æŸ¥Javaè¯­æ³•é”™è¯¯
- **ä¸€æ¬¡æ€§æ“ä½œ**ï¼šç¼–è¯‘æˆåŠŸåä¸ä¼šé‡å¤ç¼–è¯‘

### 2.3 ç¬¬ä¸‰é˜¶æ®µï¼šåŠ è½½ï¼ˆLoadingï¼‰â­â­


**è¿™ä¸ªé˜¶æ®µåœ¨å¹²ä»€ä¹ˆï¼Ÿ**
> JVMæŠŠç¼–è¯‘å¥½çš„`.class`æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­

```
ç±»åŠ è½½è¿‡ç¨‹ï¼š

ç£ç›˜ä¸Šçš„.classæ–‡ä»¶ â†’ JVMå†…å­˜ â†’ åˆ›å»ºClasså¯¹è±¡
```

**ğŸ”¸ åŠ è½½é˜¶æ®µçš„ç‰¹ç‚¹**ï¼š
- **å†…å­˜åŠ è½½**ï¼šå­—èŠ‚ç æ–‡ä»¶è¢«åŠ è½½åˆ°JVMå†…å­˜
- **åˆ›å»ºClasså¯¹è±¡**ï¼šä¸ºåç»­å®ä¾‹åŒ–åšå‡†å¤‡
- **éªŒè¯å­—èŠ‚ç **ï¼šç¡®ä¿å­—èŠ‚ç çš„å®‰å…¨æ€§å’Œæ­£ç¡®æ€§

### 2.4 ç¬¬å››é˜¶æ®µï¼šåˆå§‹åŒ–ï¼ˆInitializationï¼‰â­â­â­


**è¿™ä¸ªé˜¶æ®µåœ¨å¹²ä»€ä¹ˆï¼Ÿ**
> åˆ›å»ºJSPé¡µé¢çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶è°ƒç”¨`_jspInit()`æ–¹æ³•

```
åˆå§‹åŒ–è¿‡ç¨‹ï¼š

1. åˆ›å»ºJSPå®ä¾‹å¯¹è±¡
2. è°ƒç”¨ _jspInit() æ–¹æ³•
3. å‡†å¤‡å¥½å¤„ç†ç”¨æˆ·è¯·æ±‚
```

**ğŸ”¸ `_jspInit()`æ–¹æ³•çš„ä½œç”¨**ï¼š
- **åˆå§‹åŒ–èµ„æº**ï¼šæ•°æ®åº“è¿æ¥ã€é…ç½®å‚æ•°ç­‰
- **åªæ‰§è¡Œä¸€æ¬¡**ï¼šæ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä»…è°ƒç”¨ä¸€æ¬¡
- **å‡†å¤‡å·¥ä½œ**ï¼šä¸ºå¤„ç†è¯·æ±‚åšå‡†å¤‡

### 2.5 ç¬¬äº”é˜¶æ®µï¼šè¯·æ±‚å¤„ç†ï¼ˆRequest Processingï¼‰â­â­â­


**è¿™ä¸ªé˜¶æ®µåœ¨å¹²ä»€ä¹ˆï¼Ÿ**
> æ¯å½“ç”¨æˆ·è¯·æ±‚JSPé¡µé¢æ—¶ï¼Œè°ƒç”¨`_jspService()`æ–¹æ³•å¤„ç†è¯·æ±‚

```
è¯·æ±‚å¤„ç†æµç¨‹ï¼š

ç”¨æˆ·è¯·æ±‚ â†’ _jspService()æ–¹æ³•è¢«è°ƒç”¨ â†’ ç”ŸæˆHTMLå“åº” â†’ è¿”å›ç»™æµè§ˆå™¨

è¿™ä¸ªè¿‡ç¨‹ä¼šé‡å¤æ‰§è¡Œï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ï¼
```

**ğŸ”¸ è¯·æ±‚å¤„ç†çš„ç‰¹ç‚¹**ï¼š
- **é¢‘ç¹æ‰§è¡Œ**ï¼šæ¯ä¸ªç”¨æˆ·è¯·æ±‚éƒ½ä¼šæ‰§è¡Œ
- **å¤šçº¿ç¨‹**ï¼šå¯èƒ½åŒæ—¶å¤„ç†å¤šä¸ªç”¨æˆ·è¯·æ±‚
- **ç”Ÿæˆå“åº”**ï¼šåŠ¨æ€ç”ŸæˆHTMLå†…å®¹è¿”å›ç»™æµè§ˆå™¨

### 2.6 ç¬¬å…­é˜¶æ®µï¼šé”€æ¯ï¼ˆDestructionï¼‰â­â­


**è¿™ä¸ªé˜¶æ®µåœ¨å¹²ä»€ä¹ˆï¼Ÿ**
> å½“JSPé¡µé¢ä¸å†éœ€è¦æ—¶ï¼Œè°ƒç”¨`_jspDestroy()`æ–¹æ³•è¿›è¡Œæ¸…ç†

```
é”€æ¯æ—¶æœºï¼š
- æœåŠ¡å™¨å…³é—­
- åº”ç”¨ç¨‹åºå¸è½½
- JSPé¡µé¢é•¿æ—¶é—´æœªä½¿ç”¨
- å†…å­˜ä¸è¶³éœ€è¦å›æ”¶
```

**ğŸ”¸ é”€æ¯é˜¶æ®µçš„ç‰¹ç‚¹**ï¼š
- **æ¸…ç†èµ„æº**ï¼šå…³é—­æ•°æ®åº“è¿æ¥ã€é‡Šæ”¾å†…å­˜ç­‰
- **åªæ‰§è¡Œä¸€æ¬¡**ï¼šç”Ÿå‘½å‘¨æœŸç»“æŸå‰çš„æœ€åä¸€æ­¥
- **è‡ªåŠ¨è°ƒç”¨**ï¼šå®¹å™¨è´Ÿè´£è°ƒç”¨ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

---

## 3. ğŸ”§ ä¸‰å¤§æ ¸å¿ƒæ–¹æ³•è¯¦è§£


### 3.1 _jspInit()æ–¹æ³•è¯¦è§£ `[åˆå§‹åŒ–æ–¹æ³•]`


**ğŸ”¸ æ–¹æ³•ä½œç”¨**ï¼š
```
ç®€å•ç†è§£ï¼šè¿™æ˜¯JSPé¡µé¢çš„"å¼€æœºå¯åŠ¨"æ–¹æ³•
ä½œç”¨ï¼šè¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–å·¥ä½œ
```

**ğŸ”¸ æ‰§è¡Œæ—¶æœº**ï¼š
- JSPé¡µé¢**ç¬¬ä¸€æ¬¡è¢«è¯·æ±‚**æ—¶æ‰§è¡Œ
- æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­**åªæ‰§è¡Œä¸€æ¬¡**
- åœ¨ä»»ä½•`_jspService()`è°ƒç”¨ä¹‹å‰æ‰§è¡Œ

**ğŸ”¸ å…¸å‹ç”¨é€”**ï¼š
```java
// åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
private Connection conn;

public void _jspInit() {
    try {
        // åŠ è½½æ•°æ®åº“é©±åŠ¨
        Class.forName("com.mysql.jdbc.Driver");
        // åˆ›å»ºæ•°æ®åº“è¿æ¥
        conn = DriverManager.getConnection(
            "jdbc:mysql://localhost:3306/mydb", 
            "root", 
            "password"
        );
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

**ğŸ’¡ è®°å¿†æŠ€å·§**ï¼š
> `_jspInit()` = JSPçš„"æ„é€ å‡½æ•°"ï¼Œè´Ÿè´£é¡µé¢çš„åˆå§‹åŒ–å·¥ä½œ

### 3.2 _jspService()æ–¹æ³•è¯¦è§£ `[æœåŠ¡æ–¹æ³•]`


**ğŸ”¸ æ–¹æ³•ä½œç”¨**ï¼š
```
ç®€å•ç†è§£ï¼šè¿™æ˜¯JSPé¡µé¢çš„"å·¥ä½œæ–¹æ³•"
ä½œç”¨ï¼šå¤„ç†æ¯ä¸€ä¸ªç”¨æˆ·è¯·æ±‚ï¼Œç”Ÿæˆå“åº”å†…å®¹
```

**ğŸ”¸ æ‰§è¡Œæ—¶æœº**ï¼š
- **æ¯æ¬¡è¯·æ±‚**éƒ½ä¼šæ‰§è¡Œ
- æ˜¯JSPé¡µé¢çš„**æ ¸å¿ƒå·¥ä½œæ–¹æ³•**
- å¯èƒ½**å¹¶å‘æ‰§è¡Œ**ï¼ˆå¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®ï¼‰

**ğŸ”¸ æ–¹æ³•å‚æ•°**ï¼š
```java
public void _jspService(HttpServletRequest request, 
                       HttpServletResponse response) {
    // requestï¼šåŒ…å«ç”¨æˆ·è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯
    // responseï¼šç”¨äºç”Ÿæˆå“åº”å†…å®¹
}
```

**ğŸ”¸ æ–¹æ³•å†…å®¹**ï¼š
- å¤„ç†ç”¨æˆ·æäº¤çš„**è¡¨å•æ•°æ®**
- ä»æ•°æ®åº“**æŸ¥è¯¢æ•°æ®**
- ç”Ÿæˆ**åŠ¨æ€HTMLå†…å®¹**
- è®¾ç½®**å“åº”å¤´ä¿¡æ¯**

**ğŸ’¡ è®°å¿†æŠ€å·§**ï¼š
> `_jspService()` = JSPçš„"æœåŠ¡å‘˜"ï¼Œè´Ÿè´£å¤„ç†æ¯ä¸ªå®¢æˆ·çš„éœ€æ±‚

### 3.3 _jspDestroy()æ–¹æ³•è¯¦è§£ `[é”€æ¯æ–¹æ³•]`


**ğŸ”¸ æ–¹æ³•ä½œç”¨**ï¼š
```
ç®€å•ç†è§£ï¼šè¿™æ˜¯JSPé¡µé¢çš„"å…³æœºæ¸…ç†"æ–¹æ³•
ä½œç”¨ï¼šé‡Šæ”¾èµ„æºï¼Œè¿›è¡Œæ¸…ç†å·¥ä½œ
```

**ğŸ”¸ æ‰§è¡Œæ—¶æœº**ï¼š
- JSPé¡µé¢**è¢«é”€æ¯å‰**æ‰§è¡Œ
- æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­**åªæ‰§è¡Œä¸€æ¬¡**
- æœåŠ¡å™¨å…³é—­æˆ–åº”ç”¨å¸è½½æ—¶è§¦å‘

**ğŸ”¸ å…¸å‹ç”¨é€”**ï¼š
```java
public void _jspDestroy() {
    try {
        // å…³é—­æ•°æ®åº“è¿æ¥
        if (conn != null && !conn.isClosed()) {
            conn.close();
        }
        // æ¸…ç†å…¶ä»–èµ„æº
        // ...
    } catch (SQLException e) {
        e.printStackTrace();
    }
}
```

**ğŸ’¡ è®°å¿†æŠ€å·§**ï¼š
> `_jspDestroy()` = JSPçš„"ææ„å‡½æ•°"ï¼Œè´Ÿè´£é¡µé¢çš„æ¸…ç†å·¥ä½œ

---

## 4. âš™ï¸ JSPç¼–è¯‘æˆServletçš„è¿‡ç¨‹


### 4.1 ç¼–è¯‘è¿‡ç¨‹è¯¦ç»†è§£æ


**ğŸ”¸ ç¼–è¯‘çš„æœ¬è´¨**ï¼š
```
æ ¸å¿ƒç†è§£ï¼šJSPå®é™…ä¸Šå°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„Servletç¼–å†™æ–¹å¼
JSPæ–‡ä»¶ â†’ Servletæºç  â†’ Servletå­—èŠ‚ç  â†’ Servletå®ä¾‹
```

### 4.2 ç¼–è¯‘è¿‡ç¨‹å›¾ç¤º


```
JSPåˆ°Servletçš„è½¬æ¢è¿‡ç¨‹ï¼š

æ­¥éª¤1ï¼šJSPæºç 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.jsp           â”‚
â”‚ <%@ page ... %>     â”‚
â”‚ <html>             â”‚
â”‚   <% String name    â”‚
â”‚      = "World"; %>  â”‚
â”‚   <p>Hello <%= name â”‚
â”‚      %></p>         â”‚
â”‚ </html>            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ç¿»è¯‘
æ­¥éª¤2ï¼šServletæºç 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index_jsp.java      â”‚
â”‚ public class        â”‚
â”‚ index_jsp extends   â”‚
â”‚ HttpServlet {       â”‚
â”‚   public void       â”‚
â”‚   _jspService(...){ â”‚
â”‚     String name =   â”‚
â”‚     "World";        â”‚
â”‚     out.write(...); â”‚
â”‚   }                 â”‚
â”‚ }                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ç¼–è¯‘
æ­¥éª¤3ï¼šServletå­—èŠ‚ç 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index_jsp.class     â”‚
â”‚ (äºŒè¿›åˆ¶å­—èŠ‚ç æ–‡ä»¶)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ åŠ è½½æ‰§è¡Œ
æ­¥éª¤4ï¼šServletå®ä¾‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†…å­˜ä¸­çš„Servletå¯¹è±¡  â”‚
â”‚ å¤„ç†ç”¨æˆ·è¯·æ±‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ç¼–è¯‘è¿‡ç¨‹ä¸­çš„å…³é”®è½¬æ¢


**ğŸ”¸ JSPå…ƒç´ çš„è½¬æ¢è§„åˆ™**ï¼š

| JSPå…ƒç´ ç±»å‹ | **è½¬æ¢ç»“æœ** | **è¯´æ˜** |
|------------|-------------|---------|
| `HTMLæ ‡ç­¾` | `out.write("HTMLå†…å®¹")` | `ç›´æ¥è¾“å‡ºåˆ°é¡µé¢` |
| `<%! å£°æ˜ %>` | `ç±»çš„æˆå‘˜å˜é‡æˆ–æ–¹æ³•` | `æˆä¸ºServletç±»çš„ä¸€éƒ¨åˆ†` |
| `<% Javaä»£ç  %>` | `ç›´æ¥æ”¾å…¥_jspService()æ–¹æ³•ä¸­` | `åœ¨æœåŠ¡æ–¹æ³•ä¸­æ‰§è¡Œ` |
| `<%= è¡¨è¾¾å¼ %>` | `out.write(è¡¨è¾¾å¼.toString())` | `è®¡ç®—åè¾“å‡ºåˆ°é¡µé¢` |
| `<%@ æŒ‡ä»¤ %>` | `importè¯­å¥æˆ–ç±»å£°æ˜` | `å½±å“æ•´ä¸ªServletç±»` |

**ğŸ”¸ ç¼–è¯‘ä½ç½®å’Œå‘½åè§„åˆ™**ï¼š
```
ç¼–è¯‘ä½ç½®ï¼šTomcat/work/Catalina/localhost/[é¡¹ç›®å]/org/apache/jsp/

å‘½åè§„åˆ™ï¼š
index.jsp â†’ index_jsp.java â†’ index_jsp.class
user/profile.jsp â†’ user/profile_jsp.java â†’ user/profile_jsp.class
```

---

## 5. ğŸ’¡ ç”Ÿå‘½å‘¨æœŸå®è·µç†è§£


### 5.1 ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„å®é™…ä½¿ç”¨


**ğŸ”¸ å®è·µåœºæ™¯ç¤ºä¾‹**ï¼š

```java
<%!
    // å£°æ˜åŒºåŸŸï¼šæˆä¸ºServletçš„æˆå‘˜å˜é‡
    private int visitCount = 0;
    private Connection dbConn;
    
    // _jspInit()æ–¹æ³•ï¼šåˆå§‹åŒ–å·¥ä½œ
    public void jspInit() {
        try {
            // åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
            Class.forName("com.mysql.jdbc.Driver");
            dbConn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/mydb", "root", "pass");
            
            // åˆå§‹åŒ–è®¡æ•°å™¨
            visitCount = 0;
            
            // è®°å½•åˆå§‹åŒ–æ—¥å¿—
            System.out.println("JSPé¡µé¢åˆå§‹åŒ–å®Œæˆï¼š" + new Date());
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    // _jspDestroy()æ–¹æ³•ï¼šæ¸…ç†å·¥ä½œ
    public void jspDestroy() {
        try {
            // å…³é—­æ•°æ®åº“è¿æ¥
            if (dbConn != null) {
                dbConn.close();
            }
            // è®°å½•é”€æ¯æ—¥å¿—
            System.out.println("JSPé¡µé¢é”€æ¯ï¼š" + new Date());
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
%>

<%
    // è¿™éƒ¨åˆ†ä»£ç åœ¨_jspService()æ–¹æ³•ä¸­æ‰§è¡Œ
    // æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰§è¡Œ
    visitCount++;
    String currentTime = new Date().toString();
%>

<html>
<body>
    <h2>JSPç”Ÿå‘½å‘¨æœŸæ¼”ç¤º</h2>
    <p>é¡µé¢è®¿é—®æ¬¡æ•°ï¼š<%= visitCount %></p>
    <p>å½“å‰æ—¶é—´ï¼š<%= currentTime %></p>
</body>
</html>
```

### 5.2 ç”Ÿå‘½å‘¨æœŸçš„æ€§èƒ½è€ƒè™‘


**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼š

```
åˆå§‹åŒ–ä¼˜åŒ–ï¼š
âœ… åœ¨_jspInit()ä¸­åˆ›å»ºæ˜‚è´µçš„èµ„æºï¼ˆæ•°æ®åº“è¿æ¥æ± ï¼‰
âœ… åˆå§‹åŒ–é™æ€é…ç½®æ•°æ®
âŒ ä¸è¦åœ¨_jspService()ä¸­é‡å¤åˆ›å»ºç›¸åŒèµ„æº

è¯·æ±‚å¤„ç†ä¼˜åŒ–ï¼š
âœ… _jspService()æ–¹æ³•è¦å°½å¯èƒ½å¿«é€Ÿæ‰§è¡Œ
âœ… é¿å…åœ¨æœåŠ¡æ–¹æ³•ä¸­è¿›è¡Œè€—æ—¶æ“ä½œ
âŒ ä¸è¦åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½åˆ›å»ºæ•°æ®åº“è¿æ¥

é”€æ¯ä¼˜åŒ–ï¼š
âœ… åœ¨_jspDestroy()ä¸­æ­£ç¡®é‡Šæ”¾æ‰€æœ‰èµ„æº
âœ… é¿å…å†…å­˜æ³„æ¼
```

### 5.3 å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦æé†’**ï¼š
```
çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š
- _jspService()æ–¹æ³•å¯èƒ½è¢«å¤šä¸ªç”¨æˆ·çº¿ç¨‹åŒæ—¶è°ƒç”¨
- æˆå‘˜å˜é‡ä¼šè¢«å¤šä¸ªçº¿ç¨‹å…±äº«
- éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜

è§£å†³æ–¹æ¡ˆï¼š
1. å°½é‡ä½¿ç”¨å±€éƒ¨å˜é‡ï¼ˆæ–¹æ³•å†…å˜é‡ï¼‰
2. å¯¹å…±äº«èµ„æºä½¿ç”¨synchronizedå…³é”®å­—
3. ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ç±»å’Œæ–¹æ³•
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ JSPç”Ÿå‘½å‘¨æœŸï¼šç¿»è¯‘â†’ç¼–è¯‘â†’åŠ è½½â†’åˆå§‹åŒ–â†’è¯·æ±‚å¤„ç†â†’é”€æ¯
ğŸ”¸ ä¸‰å¤§æ ¸å¿ƒæ–¹æ³•ï¼š_jspInit()ã€_jspService()ã€_jspDestroy()
ğŸ”¸ ç¼–è¯‘æœ¬è´¨ï¼šJSPæœ€ç»ˆä¼šç¼–è¯‘æˆServletæ¥æ‰§è¡Œ
ğŸ”¸ æ‰§è¡Œç‰¹ç‚¹ï¼šåˆå§‹åŒ–å’Œé”€æ¯å„ä¸€æ¬¡ï¼ŒæœåŠ¡æ–¹æ³•æ¯æ¬¡è¯·æ±‚æ‰§è¡Œ
ğŸ”¸ çº¿ç¨‹å®‰å…¨ï¼š_jspService()æ–¹æ³•å¯èƒ½å¹¶å‘æ‰§è¡Œï¼Œéœ€æ³¨æ„çº¿ç¨‹å®‰å…¨
```

### 6.2 ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¯¹æ¯”


| æ–¹æ³•å | **æ‰§è¡Œæ—¶æœº** | **æ‰§è¡Œæ¬¡æ•°** | **ä¸»è¦ä½œç”¨** | **å…¸å‹ç”¨é€”** |
|--------|-------------|-------------|-------------|-------------|
| `_jspInit()` | `é¦–æ¬¡è¯·æ±‚æ—¶` | `ä»…ä¸€æ¬¡` | `åˆå§‹åŒ–èµ„æº` | `åˆ›å»ºæ•°æ®åº“è¿æ¥` |
| `_jspService()` | `æ¯æ¬¡è¯·æ±‚æ—¶` | `å¤šæ¬¡` | `å¤„ç†è¯·æ±‚` | `ç”Ÿæˆé¡µé¢å†…å®¹` |
| `_jspDestroy()` | `é”€æ¯å‰` | `ä»…ä¸€æ¬¡` | `æ¸…ç†èµ„æº` | `å…³é—­æ•°æ®åº“è¿æ¥` |

### 6.3 å®é™…å¼€å‘è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™éœ€è¦å…³æ³¨ç”Ÿå‘½å‘¨æœŸï¼Ÿ**
```
éœ€è¦å…³æ³¨çš„æƒ…å†µï¼š
âœ… éœ€è¦åˆå§‹åŒ–èµ„æºï¼ˆæ•°æ®åº“è¿æ¥ã€é…ç½®æ–‡ä»¶ï¼‰
âœ… éœ€è¦è¿›è¡Œèµ„æºæ¸…ç†ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰
âœ… éœ€è¦ç»Ÿè®¡é¡µé¢è®¿é—®ä¿¡æ¯
âœ… éœ€è¦ç¼“å­˜æŸäº›æ•°æ®

ä¸éœ€è¦ç‰¹åˆ«å…³æ³¨çš„æƒ…å†µï¼š
- ç®€å•çš„é™æ€é¡µé¢æ˜¾ç¤º
- åŸºæœ¬çš„æ•°æ®æŸ¥è¯¢å’Œæ˜¾ç¤º
- ç®€å•çš„è¡¨å•å¤„ç†
```

**ğŸ”¹ å¸¸è§è¯¯åŒºé¿å…**ï¼š
```
âŒ è¯¯åŒº1ï¼šè®¤ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½ä¼šé‡æ–°ç¼–è¯‘JSP
âœ… æ­£ç¡®ï¼šåªæœ‰é¦–æ¬¡è¯·æ±‚æˆ–æ–‡ä»¶ä¿®æ”¹åæ‰ä¼šé‡æ–°ç¼–è¯‘

âŒ è¯¯åŒº2ï¼šåœ¨_jspService()ä¸­è¿›è¡Œèµ„æºåˆå§‹åŒ–
âœ… æ­£ç¡®ï¼šèµ„æºåˆå§‹åŒ–åº”è¯¥åœ¨_jspInit()ä¸­è¿›è¡Œ

âŒ è¯¯åŒº3ï¼šå¿˜è®°åœ¨_jspDestroy()ä¸­æ¸…ç†èµ„æº
âœ… æ­£ç¡®ï¼šå¿…é¡»æ­£ç¡®æ¸…ç†èµ„æºé˜²æ­¢å†…å­˜æ³„æ¼
```

### 6.4 å­¦ä¹ æ£€æŸ¥ç‚¹


**ğŸ“‹ è‡ªæˆ‘æ£€éªŒæ¸…å•**ï¼š
- [ ] èƒ½è¯´å‡ºJSPç”Ÿå‘½å‘¨æœŸçš„6ä¸ªé˜¶æ®µ
- [ ] ç†è§£ä¸‰å¤§æ ¸å¿ƒæ–¹æ³•çš„ä½œç”¨å’Œæ‰§è¡Œæ—¶æœº
- [ ] çŸ¥é“JSPå¦‚ä½•ç¼–è¯‘æˆServlet
- [ ] æ˜ç™½ä»€ä¹ˆæ—¶å€™éœ€è¦é‡å†™ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
- [ ] äº†è§£å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ³¨æ„äº‹é¡¹

**ğŸ¯ å®è·µç»ƒä¹ å»ºè®®**ï¼š
1. åˆ›å»ºä¸€ä¸ªJSPé¡µé¢ï¼Œé‡å†™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•
2. æŸ¥çœ‹Tomcatçš„workç›®å½•ï¼Œè§‚å¯Ÿç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶
3. ä½¿ç”¨è®¿é—®è®¡æ•°å™¨ç†è§£æ–¹æ³•æ‰§è¡Œæ—¶æœº
4. æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥çš„åˆå§‹åŒ–å’Œæ¸…ç†

**æ ¸å¿ƒè®°å¿†**ï¼š
> JSPç”Ÿå‘½å‘¨æœŸå°±åƒé¤å…è¿è¥ï¼šå¼€åº—å‡†å¤‡(init) â†’ æœåŠ¡é¡¾å®¢(service) â†’ æ‰“çƒŠæ¸…ç†(destroy)
> JSPæœ¬è´¨æ˜¯Servletçš„ç®€åŒ–å†™æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šç¼–è¯‘æˆServletæ‰§è¡Œ