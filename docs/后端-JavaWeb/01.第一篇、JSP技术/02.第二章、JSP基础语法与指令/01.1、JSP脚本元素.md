---
title: 1、JSP脚本元素
---
## 📚 目录

1. [JSP脚本元素概述](#1-JSP脚本元素概述)
2. [脚本片段（Scriptlet）详解](#2-脚本片段scriptlet详解)
3. [表达式（Expression）详解](#3-表达式expression详解)
4. [声明（Declaration）详解](#4-声明declaration详解)
5. [脚本元素的执行顺序](#5-脚本元素的执行顺序)
6. [最佳实践与注意事项](#6-最佳实践与注意事项)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🌐 JSP脚本元素概述


### 1.1 什么是JSP脚本元素


**🔸 通俗理解**
想象你在写一个网页，既要显示静态的HTML内容，又要显示动态的数据（比如当前时间、用户姓名等）。JSP脚本元素就像是在HTML中嵌入的"Java代码窗口"，让你可以在网页中直接写Java代码来处理这些动态内容。

```
普通HTML页面：
<h1>欢迎访问我们的网站</h1>  ← 固定不变的内容

JSP页面：
<h1>欢迎访问我们的网站，<%=username%>！</h1>  ← 可以显示用户名
```

### 1.2 JSP脚本元素的三大类型


**📋 核心分类**
```
JSP脚本元素家族：
┌─────────────────────────┐
│  脚本片段（Scriptlet）    │ ← <% Java代码 %>
├─────────────────────────┤
│  表达式（Expression）    │ ← <%= 要输出的值 %>  
├─────────────────────────┤
│  声明（Declaration）     │ ← <%! 方法或变量声明 %>
└─────────────────────────┘

每种都有不同的作用和使用场景！
```

### 1.3 为什么需要脚本元素


**💡 实际需求场景**
```
静态网页的局限性：
❌ 无法显示当前时间
❌ 无法根据用户显示不同内容  
❌ 无法进行数据库查询
❌ 无法实现逻辑判断

JSP脚本元素的解决方案：
✅ 动态显示服务器时间
✅ 个性化用户体验
✅ 数据库数据展示
✅ 条件判断和循环处理
```

---

## 2. 📝 脚本片段（Scriptlet）详解


### 2.1 脚本片段基本概念


**🔸 什么是脚本片段**
脚本片段就是在JSP页面中直接写Java代码的地方，用 `<% %>` 包围起来。可以把它想象成在HTML中挖了一个"Java代码坑"，你可以在这个坑里写任何Java语句。

**📋 基本语法**
```jsp
<% 
    // 这里写Java代码
    // 可以是变量声明、条件判断、循环等
%>
```

### 2.2 脚本片段的使用场景


**🎯 典型应用场景**

**场景1：变量定义和计算**
```jsp
<%
    // 定义变量
    String username = "小明";
    int age = 25;
    
    // 进行计算
    int nextYear = age + 1;
%>

<p>用户：<%=username%>，今年<%=age%>岁，明年<%=nextYear%>岁</p>
```

**场景2：条件判断显示不同内容**
```jsp
<%
    int score = 85;
%>

<div>
    <h3>考试结果：</h3>
    <%
        if (score >= 90) {
    %>
        <p style="color: green;">优秀！恭喜你！</p>
    <%
        } else if (score >= 60) {
    %>
        <p style="color: blue;">及格了，继续努力！</p>
    <%
        } else {
    %>
        <p style="color: red;">不及格，需要补考！</p>
    <%
        }
    %>
</div>
```

**场景3：循环生成动态内容**
```jsp
<ul>
<%
    String[] cities = {"北京", "上海", "广州", "深圳"};
    for (int i = 0; i < cities.length; i++) {
%>
    <li>第<%=i+1%>大城市：<%=cities[i]%></li>
<%
    }
%>
</ul>
```

### 2.3 脚本片段的特点


**✅ 脚本片段的优势**
```
灵活性强：可以写任何Java代码
逻辑控制：支持条件判断和循环
变量作用：可以定义局部变量
代码复用：可以调用Java方法
```

**⚠️ 需要注意的问题**
```
可读性：HTML和Java代码混合，可能难以阅读
维护性：代码分散在页面各处，维护困难
调试难度：错误定位相对困难
```

---

## 3. 📤 表达式（Expression）详解


### 3.1 表达式基本概念


**🔸 什么是表达式**
表达式是JSP中最简单直接的脚本元素，专门用来**输出值**到网页上。可以把它想象成一个"显示器"，你给它什么值，它就显示什么。

**📋 基本语法**
```jsp
<%= 要输出的值 %>

注意：
- 等号后面直接跟要输出的内容
- 不需要写分号
- 会自动转换成字符串显示在页面上
```

### 3.2 表达式的使用场景


**🎯 各种输出需求**

**输出简单值：**
```jsp
<!-- 输出字符串 -->
<p>网站名称：<%= "JavaWeb学习网站" %></p>

<!-- 输出数字 -->
<p>当前访问量：<%= 12580 %>人次</p>

<!-- 输出计算结果 -->
<p>1 + 2 = <%= 1 + 2 %></p>
```

**输出变量值：**
```jsp
<%
    String siteName = "我的博客";
    int visitCount = 999;
    double price = 29.99;
%>

<div>
    <h2><%=siteName%></h2>
    <p>访问次数：<%=visitCount%></p>
    <p>商品价格：￥<%=price%></p>
</div>
```

**输出方法调用结果：**
```jsp
<!-- 输出当前时间 -->
<p>当前时间：<%= new java.util.Date() %></p>

<!-- 输出字符串处理结果 -->
<%
    String message = "hello world";
%>
<p>大写结果：<%= message.toUpperCase() %></p>
```

### 3.3 表达式与脚本片段的区别


**🆚 对比理解**

| 特性 | **脚本片段 `<% %>`** | **表达式 `<%= %>`** |
|------|-------------------|-------------------|
| **主要用途** | `执行Java代码` | `输出值到页面` |
| **语法要求** | `需要分号结尾` | `不需要分号` |
| **输出功能** | `不直接输出` | `自动输出到页面` |
| **使用场景** | `逻辑处理、条件判断` | `显示数据、变量值` |

**实际对比示例：**
```jsp
<!-- 脚本片段：执行逻辑，不直接输出 -->
<%
    int a = 5;
    int b = 3;
    int result = a + b;  // 执行计算，但不显示
%>

<!-- 表达式：输出计算结果 -->
<p><%=a%> + <%=b%> = <%=result%></p>
```

---

## 4. 📋 声明（Declaration）详解


### 4.1 声明基本概念


**🔸 什么是声明**
声明是用来在JSP页面中定义**方法**和**成员变量**的脚本元素。可以把它想象成在JSP页面中创建一个"工具箱"，里面放着你自定义的工具（方法）和材料（成员变量）。

**📋 基本语法**
```jsp
<%! 
    // 在这里声明方法或成员变量
    // 这些会成为生成的Servlet类的成员
%>
```

### 4.2 声明与脚本片段的重要区别


**🔍 理解两者的本质差异**

```
JSP页面转换成Servlet类的结构：

public class MyPage_jsp extends HttpServlet {
    // <%! %> 声明的内容会放在这里（类成员位置）
    private String siteName = "我的网站";
    
    public void service(HttpServletRequest request, HttpServletResponse response) {
        // <% %> 脚本片段的内容会放在这里（方法内部）
        int localVar = 10;
        
        out.print("内容");  // <%= %> 表达式转换成的输出语句
    }
}
```

### 4.3 声明的使用场景


**🎯 声明成员变量**
```jsp
<%! 
    // 声明成员变量（整个页面共享）
    private String websiteName = "JavaWeb学习站";
    private int totalVisitors = 0;
    private java.util.Date startDate = new java.util.Date();
%>

<h1>欢迎访问：<%=websiteName%></h1>
<p>网站启动时间：<%=startDate%></p>
```

**🎯 声明自定义方法**
```jsp
<%! 
    // 声明一个计算方法
    public int calculateSum(int a, int b) {
        return a + b;
    }
    
    // 声明一个格式化日期的方法
    public String formatDate(java.util.Date date) {
        java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat("yyyy年MM月dd日");
        return sdf.format(date);
    }
%>

<div>
    <p>计算结果：5 + 3 = <%=calculateSum(5, 3)%></p>
    <p>今天是：<%=formatDate(new java.util.Date())%></p>
</div>
```

### 4.4 声明使用注意事项


**⚠️ 重要提醒**

**线程安全问题：**
```jsp
<%! 
    private int counter = 0;  // 所有用户共享这个变量！
    
    public synchronized int getNextNumber() {
        return ++counter;  // 需要同步控制
    }
%>

<!-- 每个用户访问都会影响这个计数器 -->
<p>您是第<%=getNextNumber()%>位访问者</p>
```

**变量作用域对比：**
```jsp
<%! 
    private String memberVar = "我是成员变量";  // 所有用户共享
%>

<%
    String localVar = "我是局部变量";  // 每个请求独有
%>

<p>成员变量：<%=memberVar%></p>  <!-- 所有用户看到相同内容 -->
<p>局部变量：<%=localVar%></p>    <!-- 每个用户独立 -->
```

---

## 5. ⚡ 脚本元素的执行顺序


### 5.1 JSP页面的生命周期


**📊 理解JSP到Servlet的转换过程**

```
JSP页面执行流程：
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  JSP页面    │───▶│ Servlet类   │───▶│  HTML响应   │
│  .jsp文件   │    │ .java文件   │    │  给浏览器   │
└─────────────┘    └─────────────┘    └─────────────┘
     ↑                    ↑                    ↑
  编写阶段              编译阶段              运行阶段
```

### 5.2 不同脚本元素的执行时机


**⏰ 执行顺序详解**

```jsp
<%! 
    // 第1步：声明元素 - 成为类的成员（编译时确定）
    private String className = "MyJSP";
    
    public String getWelcomeMessage() {
        return "欢迎访问 " + className;
    }
%>

<html>
<head>
    <title><%=className%></title>  <!-- 第3步：表达式输出 -->
</head>
<body>
    <%
        // 第2步：脚本片段执行（每次请求时）
        String currentTime = new java.util.Date().toString();
        int randomNum = (int)(Math.random() * 100);
    %>
    
    <h1><%=getWelcomeMessage()%></h1>        <!-- 第3步：调用声明的方法 -->
    <p>当前时间：<%=currentTime%></p>          <!-- 第3步：输出脚本片段中的变量 -->
    <p>随机数：<%=randomNum%></p>             <!-- 第3步：输出脚本片段中的变量 -->
</body>
</html>
```

**🔄 转换后的Servlet结构示意**
```java
public class MyPage_jsp extends HttpServlet {
    // 声明元素转换到这里
    private String className = "MyJSP";
    public String getWelcomeMessage() { return "欢迎访问 " + className; }
    
    public void service(HttpServletRequest request, HttpServletResponse response) {
        // 脚本片段转换到这里  
        String currentTime = new java.util.Date().toString();
        int randomNum = (int)(Math.random() * 100);
        
        // 表达式转换成输出语句
        out.print("<title>" + className + "</title>");
        out.print("<h1>" + getWelcomeMessage() + "</h1>");
        out.print("<p>当前时间：" + currentTime + "</p>");
    }
}
```

---

## 6. 🛠️ 最佳实践与注意事项


### 6.1 脚本元素使用原则


**✅ 推荐做法**

**保持代码简洁：**
```jsp
<!-- ✅ 好的做法：简单的条件判断 -->
<%
    String userType = (String)session.getAttribute("userType");
%>

<div>
    <% if ("admin".equals(userType)) { %>
        <a href="admin.jsp">管理面板</a>
    <% } else { %>
        <a href="user.jsp">用户中心</a>
    <% } %>
</div>
```

**合理使用声明：**
```jsp
<%! 
    // ✅ 声明工具方法
    public String formatMoney(double amount) {
        return String.format("￥%.2f", amount);
    }
%>

<p>商品价格：<%=formatMoney(29.99)%></p>
```

### 6.2 常见错误避免


**❌ 需要避免的问题**

**混淆脚本片段和表达式：**
```jsp
<!-- ❌ 错误：在表达式中写分号 -->
<p><%= int a = 5; %></p>  <!-- 这会报错！ -->

<!-- ✅ 正确：分开写 -->
<% int a = 5; %>
<p>值是：<%=a%></p>
```

**变量作用域混乱：**
```jsp
<!-- ❌ 错误：跨脚本片段使用变量 -->
<% int num = 10; %>
<p>一些HTML内容</p>
<%= num %>  <!-- 这里可能无法访问num -->

<!-- ✅ 正确：在同一个脚本片段中使用 -->
<%
    int num = 10;
%>
<p>数值是：<%=num%></p>
```

### 6.3 性能优化建议


**⚡ 优化技巧**

**避免重复计算：**
```jsp
<%
    // ✅ 计算一次，多次使用
    java.util.Date now = new java.util.Date();
    String formattedDate = new java.text.SimpleDateFormat("yyyy-MM-dd").format(now);
%>

<p>日期：<%=formattedDate%></p>
<p>备注：今天是<%=formattedDate%></p>
```

**合理使用成员变量：**
```jsp
<%! 
    // ✅ 缓存不变的内容
    private final String SITE_NAME = "我的网站";
    private final String COPYRIGHT = "© 2024 版权所有";
%>

<footer>
    <p><%=SITE_NAME%> <%=COPYRIGHT%></p>
</footer>
```

---

## 7. 📋 核心要点总结


### 7.1 三种脚本元素对比


| 脚本元素 | **语法** | **主要用途** | **典型场景** |
|---------|---------|------------|------------|
| **脚本片段** | `<% 代码 %>` | `执行Java逻辑` | `条件判断、循环、变量声明` |
| **表达式** | `<%= 值 %>` | `输出内容到页面` | `显示变量、计算结果、方法返回值` |
| **声明** | `<%! 声明 %>` | `定义方法和成员变量` | `工具方法、共享变量、常量定义` |

### 7.2 记忆要点


**🧠 记忆技巧**
```
脚本片段（Scriptlet）：<% %>
- 想象成"工作台"，在这里干活（执行代码）
- 有分号，像写普通Java代码

表达式（Expression）：<%= %>  
- 想象成"显示屏"，把结果显示出来
- 等号提示"输出等于什么"
- 无分号，直接写要输出的内容

声明（Declaration）：<%! %>
- 想象成"工具箱"，存放工具（方法）和材料（变量）  
- 感叹号提示"声明重要内容"
```

### 7.3 使用建议


**🎯 选择指南**
```
需要执行逻辑？ → 使用脚本片段 <% %>
需要输出内容？ → 使用表达式 <%= %>  
需要定义方法？ → 使用声明 <%! %>

简单输出 → 表达式
复杂逻辑 → 脚本片段  
工具方法 → 声明
```

**⚠️ 注意事项**
```
✅ 代码简洁，逻辑清晰
✅ 合理选择脚本元素类型
✅ 注意变量作用域
✅ 考虑线程安全问题
❌ 避免过度使用，影响可读性
❌ 避免在表达式中写复杂逻辑
```

**核心理解**：JSP脚本元素是在HTML中嵌入Java代码的桥梁，让静态页面具备动态能力。掌握三种元素的特点和使用场景，就能灵活构建动态网页内容。