---
title: 1ã€MVCæ¨¡å¼åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯MVCæ¨¡å¼](#1-ä»€ä¹ˆæ˜¯mvcæ¨¡å¼)
2. [JSPåœ¨MVCä¸­çš„è§’è‰²å®šä½](#2-jspåœ¨mvcä¸­çš„è§’è‰²å®šä½)
3. [JSPä¸Servletåä½œæ¨¡å¼](#3-jspä¸servletåä½œæ¨¡å¼)
4. [ä¸‰å±‚æ¶æ„è®¾è®¡æ€æƒ³](#4-ä¸‰å±‚æ¶æ„è®¾è®¡æ€æƒ³)
5. [ä¸šåŠ¡é€»è¾‘åˆ†ç¦»åŸåˆ™](#5-ä¸šåŠ¡é€»è¾‘åˆ†ç¦»åŸåˆ™)
6. [ç»¼åˆå®è·µæ¡ˆä¾‹](#6-ç»¼åˆå®è·µæ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ ä»€ä¹ˆæ˜¯MVCæ¨¡å¼


### 1.1 MVCæ¨¡å¼çš„é€šä¿—ç†è§£


> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> MVCå°±åƒä¸€ä¸ªé¤å…çš„åˆ†å·¥æ¨¡å¼ï¼šæœåŠ¡å‘˜è´Ÿè´£å’Œå®¢äººæ²Ÿé€šï¼ˆViewï¼‰ï¼Œå¨å¸ˆè´Ÿè´£åšèœï¼ˆControllerï¼‰ï¼Œé£Ÿæåº“æˆ¿è´Ÿè´£æä¾›åŸæ–™ï¼ˆModelï¼‰

**MVCæ¨¡å¼ç®€å•è§£é‡Š**ï¼š
- ğŸ½ï¸ **é¤å…ç±»æ¯”**ï¼šå®¢äººç‚¹èœ â†’ æœåŠ¡å‘˜è®°å½• â†’ å¨å¸ˆåˆ¶ä½œ â†’ æœåŠ¡å‘˜ä¸Šèœ
- ğŸ’» **ç½‘ç«™ç±»æ¯”**ï¼šç”¨æˆ·ç‚¹å‡» â†’ é¡µé¢æ˜¾ç¤º â†’ ç¨‹åºå¤„ç† â†’ è¿”å›ç»“æœ

```
ç°å®é¤å…åˆ†å·¥ï¼š                    MVCæ¨¡å¼å¯¹åº”ï¼š
      
     å®¢äºº                           ç”¨æˆ·
      â†“                             â†“
   æœåŠ¡å‘˜(æ²Ÿé€š)      â†â†’           View(è§†å›¾)
      â†“                             â†“
   å¨å¸ˆ(åˆ¶ä½œ)        â†â†’        Controller(æ§åˆ¶å™¨)
      â†“                             â†“
  é£Ÿæåº“æˆ¿(æä¾›)     â†â†’           Model(æ¨¡å‹)
```

### 1.2 MVCä¸‰ä¸ªç»„ä»¶çš„å…·ä½“èŒè´£


**ğŸ­ Modelï¼ˆæ¨¡å‹ï¼‰- æ•°æ®ç®¡å®¶**
```
èŒè´£ï¼šç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘
å…·ä½“å·¥ä½œï¼š
â€¢ è¿æ¥æ•°æ®åº“ï¼Œè·å–æ•°æ®
â€¢ å¤„ç†ä¸šåŠ¡è§„åˆ™ï¼ˆæ¯”å¦‚è®¡ç®—ä»·æ ¼ã€éªŒè¯ç”¨æˆ·ï¼‰
â€¢ ä¿å­˜å’Œæ›´æ–°ä¿¡æ¯
â€¢ å°±åƒé¤å…çš„é£Ÿæåº“æˆ¿ï¼Œæä¾›åšèœéœ€è¦çš„åŸæ–™
```

**ğŸ® Controllerï¼ˆæ§åˆ¶å™¨ï¼‰- æŒ‡æŒ¥å®˜**
```
èŒè´£ï¼šæ¥æ”¶è¯·æ±‚ï¼Œåè°ƒå¤„ç†
å…·ä½“å·¥ä½œï¼š
â€¢ æ¥æ”¶ç”¨æˆ·çš„æ“ä½œè¯·æ±‚
â€¢ å†³å®šè°ƒç”¨å“ªä¸ªModelæ¥å¤„ç†æ•°æ®
â€¢ é€‰æ‹©ç”¨å“ªä¸ªViewæ¥æ˜¾ç¤ºç»“æœ
â€¢ å°±åƒé¤å…çš„å¨å¸ˆï¼Œæ ¹æ®ç‚¹èœå•å†³å®šæ€ä¹ˆåˆ¶ä½œ
```

**ğŸ“± Viewï¼ˆè§†å›¾ï¼‰- å±•ç¤ºå‘˜**
```
èŒè´£ï¼šæ˜¾ç¤ºæ•°æ®ç»™ç”¨æˆ·çœ‹
å…·ä½“å·¥ä½œï¼š
â€¢ æŠŠæ•°æ®ç¾è§‚åœ°å±•ç¤ºå‡ºæ¥
â€¢ æä¾›ç”¨æˆ·æ“ä½œçš„ç•Œé¢
â€¢ ä¸å¤„ç†å¤æ‚é€»è¾‘ï¼Œåªè´Ÿè´£æ˜¾ç¤º
â€¢ å°±åƒé¤å…çš„æœåŠ¡å‘˜ï¼Œè´Ÿè´£å’Œå®¢äººæ²Ÿé€š
```

### 1.3 ä¸ºä»€ä¹ˆè¦ç”¨MVCæ¨¡å¼


**ğŸ¤” ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**ï¼š
```
é—®é¢˜åœºæ™¯ï¼šæ‰€æœ‰ä»£ç éƒ½å†™åœ¨ä¸€ä¸ªJSPæ–‡ä»¶é‡Œ

<%
    // è¿æ¥æ•°æ®åº“
    String url = "jdbc:mysql://localhost:3306/shop";
    Connection conn = DriverManager.getConnection(url, "root", "123456");
    
    // æ‰§è¡ŒæŸ¥è¯¢
    Statement stmt = conn.createStatement();
    ResultSet rs = stmt.executeQuery("SELECT * FROM products");
    
    // è®¡ç®—ä»·æ ¼
    while(rs.next()) {
        double price = rs.getDouble("price");
        if(price > 100) {
            price = price * 0.9; // æ‰“æŠ˜
        }
    }
%>
<html>
    <body>
        <!-- æ˜¾ç¤ºæ•°æ®çš„HTMLä»£ç  -->
    </body>
</html>

è¿™æ ·åšçš„é—®é¢˜ï¼š
âŒ æ•°æ®åº“ä»£ç å’Œæ˜¾ç¤ºä»£ç æ··åœ¨ä¸€èµ·
âŒ ä¿®æ”¹é¡µé¢æ ·å¼è¦ç¿»æ‰¾ä¸šåŠ¡é€»è¾‘ä»£ç 
âŒ ä»£ç é‡å¤ï¼Œéš¾ä»¥ç»´æŠ¤
âŒ å›¢é˜Ÿåˆä½œå›°éš¾ï¼ˆå‰ç«¯å’Œåç«¯æ— æ³•åˆ†å·¥ï¼‰
```

**âœ… MVCæ¨¡å¼çš„ä¼˜åŠ¿**ï¼š

| ä¼˜åŠ¿æ–¹é¢ | **å…·ä½“å¥½å¤„** | **å®é™…æ•ˆæœ** |
|---------|-------------|-------------|
| ğŸ”§ **åˆ†å·¥æ˜ç¡®** | å„å¸å…¶èŒï¼ŒèŒè´£æ¸…æ™° | å‰ç«¯è´Ÿè´£é¡µé¢ï¼Œåç«¯è´Ÿè´£é€»è¾‘ |
| ğŸ”„ **æ˜“äºç»´æŠ¤** | ä¿®æ”¹æŸéƒ¨åˆ†ä¸å½±å“å…¶ä»– | æ”¹é¡µé¢æ ·å¼ä¸ç”¨åŠ¨ä¸šåŠ¡ä»£ç  |
| ğŸš€ **ä»£ç å¤ç”¨** | åŒä¸€ä¸ªæ•°æ®å¯ç”¨ä¸åŒæ–¹å¼æ˜¾ç¤º | ä¸€ä¸ªç”¨æˆ·æ•°æ®ï¼Œå¯ä»¥ç½‘é¡µæ˜¾ç¤ºä¹Ÿå¯ä»¥æ‰‹æœºAppæ˜¾ç¤º |
| ğŸ‘¥ **å›¢é˜Ÿåä½œ** | ä¸åŒè§’è‰²å¯ä»¥å¹¶è¡Œå¼€å‘ | è®¾è®¡å¸ˆåšé¡µé¢ï¼Œç¨‹åºå‘˜å†™é€»è¾‘ï¼Œäº’ä¸å¹²æ‰° |

---

## 2. ğŸ¯ JSPåœ¨MVCä¸­çš„è§’è‰²å®šä½


### 2.1 JSPçš„ä¸“èŒå·¥ä½œ


> ğŸ’¡ **å…³é”®ç†è§£**  
> JSPåœ¨MVCæ¨¡å¼ä¸­**åªè´Ÿè´£Viewå±‚**ï¼Œå°±åƒæ¼”å‘˜åªè´Ÿè´£è¡¨æ¼”ï¼Œä¸ç®¡å‰§æœ¬æ€ä¹ˆå†™ã€é“å…·æ€ä¹ˆå‡†å¤‡

**JSPçš„æ­£ç¡®èŒè´£**ï¼š
```
âœ… JSPåº”è¯¥åšçš„äº‹ï¼š
â€¢ æ˜¾ç¤ºæ•°æ®ï¼ˆæŠŠControllerä¼ æ¥çš„æ•°æ®å±•ç¤ºç»™ç”¨æˆ·ï¼‰
â€¢ æä¾›ç”¨æˆ·ç•Œé¢ï¼ˆè¡¨å•ã€æŒ‰é’®ã€é“¾æ¥ç­‰ï¼‰
â€¢ ç¾åŒ–é¡µé¢ï¼ˆCSSæ ·å¼ã€å¸ƒå±€ç­‰ï¼‰
â€¢ ç®€å•çš„æ•°æ®æ ¼å¼åŒ–ï¼ˆæ—¥æœŸæ ¼å¼ã€è´§å¸ç¬¦å·ç­‰ï¼‰

âŒ JSPä¸åº”è¯¥åšçš„äº‹ï¼š
â€¢ è¿æ¥æ•°æ®åº“
â€¢ å¤æ‚çš„ä¸šåŠ¡è®¡ç®—
â€¢ æ•°æ®éªŒè¯å’Œå¤„ç†
â€¢ å¤æ‚çš„é€»è¾‘åˆ¤æ–­
```

### 2.2 JSPè§’è‰²å®šä½çš„å…·ä½“ä½“ç°


**ğŸ“‹ æ­£ç¡®çš„JSPå†™æ³•ç¤ºä¾‹**ï¼š
```jsp
<%@ page contentType="text/html;charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<html>
<head>
    <title>å•†å“åˆ—è¡¨</title>
    <style>
        .product-item { 
            border: 1px solid #ccc; 
            margin: 10px; 
            padding: 15px; 
        }
    </style>
</head>
<body>
    <h1>çƒ­é—¨å•†å“</h1>
    
    <!-- åªè´Ÿè´£æ˜¾ç¤ºControllerä¼ è¿‡æ¥çš„å•†å“åˆ—è¡¨ -->
    <c:forEach items="${productList}" var="product">
        <div class="product-item">
            <h3>${product.name}</h3>
            <p>ä»·æ ¼ï¼šï¿¥${product.price}</p>
            <p>åº“å­˜ï¼š${product.stock}ä»¶</p>
            
            <!-- ç®€å•çš„æ¡ä»¶æ˜¾ç¤º -->
            <c:if test="${product.stock > 0}">
                <button onclick="buyProduct(${product.id})">è´­ä¹°</button>
            </c:if>
            <c:if test="${product.stock == 0}">
                <span style="color: red;">å·²å”®ç½„</span>
            </c:if>
        </div>
    </c:forEach>
</body>
</html>
```

**ğŸš« é”™è¯¯çš„JSPå†™æ³•ç¤ºä¾‹**ï¼š
```jsp
<%@ page import="java.sql.*" %>
<%
    // âŒ é”™è¯¯ï¼šJSPç›´æ¥è¿æ¥æ•°æ®åº“
    String url = "jdbc:mysql://localhost:3306/shop";
    Connection conn = DriverManager.getConnection(url, "root", "123456");
    
    // âŒ é”™è¯¯ï¼šJSPå¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘
    String sql = "SELECT * FROM products WHERE category = ?";
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setString(1, request.getParameter("category"));
    
    // âŒ é”™è¯¯ï¼šJSPè¿›è¡Œå¤æ‚è®¡ç®—
    ResultSet rs = ps.executeQuery();
    while(rs.next()) {
        double price = rs.getDouble("price");
        double discount = calculateDiscount(price, userId); // å¤æ‚ä¸šåŠ¡é€»è¾‘
        // ...æ›´å¤šå¤æ‚å¤„ç†
    }
%>
```

### 2.3 JSPè§’è‰²çš„è¾¹ç•ŒæŠŠæ¡


**ğŸ¨ JSPå¯ä»¥åšçš„"è½»é‡çº§"å¤„ç†**ï¼š
```jsp
<!-- âœ… ç®€å•çš„æ•°æ®æ ¼å¼åŒ– -->
<p>æ³¨å†Œæ—¶é—´ï¼š<fmt:formatDate value="${user.registerDate}" pattern="yyyy-MM-dd"/></p>

<!-- âœ… ç®€å•çš„æ¡ä»¶æ˜¾ç¤º -->
<c:choose>
    <c:when test="${user.vip}">
        <span class="vip-badge">VIPä¼šå‘˜</span>
    </c:when>
    <c:otherwise>
        <span class="normal-badge">æ™®é€šä¼šå‘˜</span>
    </c:otherwise>
</c:choose>

<!-- âœ… ç®€å•çš„å¾ªç¯æ˜¾ç¤º -->
<c:forEach items="${categories}" var="category" varStatus="status">
    <a href="products?categoryId=${category.id}">
        ${category.name}
        <c:if test="${!status.last}"> | </c:if>
    </a>
</c:forEach>
```

---

## 3. ğŸ¤ JSPä¸Servletåä½œæ¨¡å¼


### 3.1 å®Œç¾æ­æ¡£çš„å·¥ä½œæµç¨‹


> ğŸ“Œ **æ ¸å¿ƒç†å¿µ**  
> Servletæ˜¯å¤§è„‘ï¼ˆæ€è€ƒå¤„ç†ï¼‰ï¼ŒJSPæ˜¯å˜´å·´ï¼ˆè¡¨è¾¾å±•ç¤ºï¼‰ã€‚å¤§è„‘æƒ³å¥½äº†å‘Šè¯‰å˜´å·´æ€ä¹ˆè¯´ï¼Œå˜´å·´è´Ÿè´£æ¸…æ¥šåœ°è¡¨è¾¾ç»™åˆ«äººå¬

**åä½œæµç¨‹å›¾ç¤º**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ Servletå¤„ç† â†’ å‡†å¤‡æ•°æ® â†’ è½¬å‘ç»™JSP â†’ JSPæ˜¾ç¤º â†’ è¿”å›ç»™ç”¨æˆ·

è¯¦ç»†æ­¥éª¤ï¼š
1. ç”¨æˆ·åœ¨æµè§ˆå™¨ç‚¹å‡»"æŸ¥çœ‹å•†å“åˆ—è¡¨"
2. è¯·æ±‚å‘é€åˆ°ProductListServlet
3. Servletè°ƒç”¨ä¸šåŠ¡å±‚è·å–å•†å“æ•°æ®
4. ServletæŠŠæ•°æ®æ”¾åˆ°requeståŸŸä¸­
5. Servletè½¬å‘è¯·æ±‚åˆ°productList.jsp
6. JSPä»requeståŸŸå–å‡ºæ•°æ®å¹¶æ˜¾ç¤º
7. æœ€ç»ˆHTMLé¡µé¢è¿”å›ç»™ç”¨æˆ·æµè§ˆå™¨
```

### 3.2 å…·ä½“åä½œä»£ç ç¤ºä¾‹


**ğŸ® Servletç«¯ï¼ˆå¤§è„‘ï¼‰- å¤„ç†é€»è¾‘**ï¼š
```java
@WebServlet("/productList")
public class ProductListServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // 1. æ¥æ”¶å‚æ•°
        String category = request.getParameter("category");
        
        // 2. è°ƒç”¨ä¸šåŠ¡å±‚è·å–æ•°æ®
        ProductService productService = new ProductService();
        List<Product> productList = productService.getProductsByCategory(category);
        
        // 3. è®¡ç®—ä¸€äº›ä¸šåŠ¡æ•°æ®
        int totalProducts = productList.size();
        double averagePrice = productService.calculateAveragePrice(productList);
        
        // 4. æŠŠæ•°æ®å‡†å¤‡å¥½ï¼Œäº¤ç»™JSPæ˜¾ç¤º
        request.setAttribute("productList", productList);
        request.setAttribute("totalProducts", totalProducts);
        request.setAttribute("averagePrice", averagePrice);
        request.setAttribute("currentCategory", category);
        
        // 5. è½¬å‘ç»™JSPé¡µé¢
        request.getRequestDispatcher("/WEB-INF/views/productList.jsp")
               .forward(request, response);
    }
}
```

**ğŸ­ JSPç«¯ï¼ˆå˜´å·´ï¼‰- è´Ÿè´£æ˜¾ç¤º**ï¼š
```jsp
<%@ page contentType="text/html;charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<html>
<head>
    <title>${currentCategory}å•†å“åˆ—è¡¨</title>
</head>
<body>
    <h1>${currentCategory}åˆ†ç±»å•†å“</h1>
    
    <!-- æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼ˆServletå·²ç»è®¡ç®—å¥½çš„ï¼‰ -->
    <div class="summary">
        <p>å…±æ‰¾åˆ° <strong>${totalProducts}</strong> ä»¶å•†å“</p>
        <p>å¹³å‡ä»·æ ¼ï¼šï¿¥<strong>${averagePrice}</strong></p>
    </div>
    
    <!-- æ˜¾ç¤ºå•†å“åˆ—è¡¨ï¼ˆServletå·²ç»æŸ¥è¯¢å¥½çš„ï¼‰ -->
    <div class="product-grid">
        <c:forEach items="${productList}" var="product">
            <div class="product-card">
                <h3>${product.name}</h3>
                <p class="price">ï¿¥${product.price}</p>
                <p class="description">${product.description}</p>
                
                <c:choose>
                    <c:when test="${product.stock > 10}">
                        <span class="stock-status in-stock">ç°è´§å……è¶³</span>
                    </c:when>
                    <c:when test="${product.stock > 0}">
                        <span class="stock-status low-stock">ä»…å‰©${product.stock}ä»¶</span>
                    </c:when>
                    <c:otherwise>
                        <span class="stock-status out-stock">æš‚æ—¶ç¼ºè´§</span>
                    </c:otherwise>
                </c:choose>
                
                <a href="productDetail?id=${product.id}" class="btn-detail">æŸ¥çœ‹è¯¦æƒ…</a>
            </div>
        </c:forEach>
    </div>
</body>
</html>
```

### 3.3 æ•°æ®ä¼ é€’çš„å¸¸ç”¨æ–¹å¼


**ğŸ“¦ Servletå‘JSPä¼ é€’æ•°æ®çš„æ–¹æ³•**ï¼š

| æ–¹æ³• | **ä½¿ç”¨åœºæ™¯** | **ä»£ç ç¤ºä¾‹** | **JSPæ¥æ”¶æ–¹å¼** |
|------|-------------|-------------|----------------|
| `request.setAttribute()` | å•æ¬¡è¯·æ±‚æ•°æ® | `request.setAttribute("user", user)` | `${user.name}` |
| `session.setAttribute()` | ç”¨æˆ·ä¼šè¯æ•°æ® | `session.setAttribute("loginUser", user)` | `${sessionScope.loginUser.name}` |
| `application.setAttribute()` | å…¨å±€åº”ç”¨æ•°æ® | `application.setAttribute("siteConfig", config)` | `${applicationScope.siteConfig.title}` |

**å®é™…ä½¿ç”¨å»ºè®®**ï¼š
```java
// âœ… æ¨èï¼šå¤§éƒ¨åˆ†æƒ…å†µç”¨requeståŸŸ
request.setAttribute("orderList", orderList);        // è®¢å•åˆ—è¡¨
request.setAttribute("pageInfo", pageInfo);          // åˆ†é¡µä¿¡æ¯
request.setAttribute("searchKeyword", keyword);      // æœç´¢å…³é”®è¯

// âœ… é€‚å½“ä½¿ç”¨sessionåŸŸ
session.setAttribute("currentUser", loginUser);      // å½“å‰ç™»å½•ç”¨æˆ·
session.setAttribute("shoppingCart", cart);          // è´­ç‰©è½¦

// âš ï¸ è°¨æ…ä½¿ç”¨applicationåŸŸï¼ˆå½±å“æ‰€æœ‰ç”¨æˆ·ï¼‰
application.setAttribute("systemConfig", config);    // ç³»ç»Ÿé…ç½®
```

---

## 4. ğŸ¢ ä¸‰å±‚æ¶æ„è®¾è®¡æ€æƒ³


### 4.1 ä¸‰å±‚æ¶æ„çš„é€šä¿—ç†è§£


> ğŸ’¡ **ç”Ÿæ´»åŒ–æ¯”å–»**  
> ä¸‰å±‚æ¶æ„å°±åƒä¸€ä¸ªè¿é”é¤å…çš„ç»„ç»‡ç»“æ„ï¼šå‰å°æœåŠ¡å‘˜ï¼ˆè¡¨ç¤ºå±‚ï¼‰ã€å¨æˆ¿ä¸»å¨ï¼ˆä¸šåŠ¡å±‚ï¼‰ã€ä»“åº“ç®¡ç†å‘˜ï¼ˆæ•°æ®å±‚ï¼‰

```
é¤å…ç»„ç»‡æ¶æ„ï¼š                    ä¸‰å±‚æ¶æ„å¯¹åº”ï¼š

    å‰å°æœåŠ¡å‘˜                       è¡¨ç¤ºå±‚(Presentation)
   (ä¸å®¢äººäº¤æµ)                     (JSP + Servlet)
        â†•                               â†•
    å¨æˆ¿ä¸»å¨                        ä¸šåŠ¡é€»è¾‘å±‚(Business)
   (åˆ¶ä½œèœå“)                       (Serviceç±»)
        â†•                               â†•
    ä»“åº“ç®¡ç†å‘˜                       æ•°æ®è®¿é—®å±‚(Data)
   (ç®¡ç†é£Ÿæ)                       (DAOç±» + Database)
```

### 4.2 ä¸‰å±‚æ¶æ„çš„å…·ä½“åˆ†å·¥


**ğŸ½ï¸ è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰**
```
è´Ÿè´£å†…å®¹ï¼š
â€¢ JSPï¼šæ˜¾ç¤ºé¡µé¢ï¼Œæ”¶é›†ç”¨æˆ·è¾“å…¥
â€¢ Servletï¼šæ¥æ”¶è¯·æ±‚ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚ï¼Œé€‰æ‹©è§†å›¾
â€¢ æ§åˆ¶å™¨ç±»ï¼šå¤„ç†è¯·æ±‚è½¬å‘å’Œé‡å®šå‘

å°±åƒé¤å…çš„æœåŠ¡å‘˜ï¼š
â€¢ æ¥å¾…å®¢äººï¼Œè®°å½•ç‚¹èœ
â€¢ æŠŠå®¢äººè¦æ±‚ä¼ è¾¾ç»™å¨æˆ¿
â€¢ æŠŠåšå¥½çš„èœç«¯ç»™å®¢äºº
```

**ğŸ³ ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Layerï¼‰**
```
è´Ÿè´£å†…å®¹ï¼š
â€¢ Serviceç±»ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†
â€¢ ä¸šåŠ¡è§„åˆ™éªŒè¯å’Œè®¡ç®—
â€¢ äº‹åŠ¡ç®¡ç†å’Œä¸šåŠ¡æµç¨‹æ§åˆ¶

å°±åƒé¤å…çš„ä¸»å¨ï¼š
â€¢ æ ¹æ®èœè°±åˆ¶ä½œèœå“
â€¢ æ§åˆ¶èœå“çš„å£å‘³å’Œè´¨é‡
â€¢ å†³å®šåˆ¶ä½œçš„å…ˆåé¡ºåº
```

**ğŸª æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰**
```
è´Ÿè´£å†…å®¹ï¼š
â€¢ DAOç±»ï¼šæ•°æ®åº“æ“ä½œå°è£…
â€¢ æ•°æ®çš„å¢åˆ æ”¹æŸ¥
â€¢ SQLè¯­å¥å’Œæ•°æ®åº“è¿æ¥ç®¡ç†

å°±åƒé¤å…çš„ä»“åº“ç®¡ç†å‘˜ï¼š
â€¢ ç®¡ç†é£Ÿæçš„è¿›å‡ºåº“
â€¢ ç¡®ä¿é£Ÿææ–°é²œå’Œå……è¶³
â€¢ è®°å½•é£Ÿæä½¿ç”¨æƒ…å†µ
```

### 4.3 ä¸‰å±‚æ¶æ„ä»£ç ç¤ºä¾‹


**ğŸ¯ å®Œæ•´çš„ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½å®ç°**ï¼š

**è¡¨ç¤ºå±‚ - RegisterServlet.java**ï¼š
```java
@WebServlet("/register")
public class RegisterServlet extends HttpServlet {
    
    private UserService userService = new UserService(); // è°ƒç”¨ä¸šåŠ¡å±‚
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // 1. æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼ˆè¡¨ç¤ºå±‚èŒè´£ï¼‰
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        String email = request.getParameter("email");
        
        try {
            // 2. è°ƒç”¨ä¸šåŠ¡å±‚å¤„ç†ï¼ˆä¸ç›´æ¥æ“ä½œæ•°æ®åº“ï¼‰
            User newUser = userService.registerUser(username, password, email);
            
            // 3. æ ¹æ®ç»“æœé€‰æ‹©é¡µé¢ï¼ˆè¡¨ç¤ºå±‚èŒè´£ï¼‰
            request.setAttribute("user", newUser);
            request.getRequestDispatcher("/WEB-INF/views/registerSuccess.jsp")
                   .forward(request, response);
                   
        } catch (UserAlreadyExistsException e) {
            // å¤„ç†ä¸šåŠ¡å¼‚å¸¸ï¼Œæ˜¾ç¤ºé”™è¯¯é¡µé¢
            request.setAttribute("errorMessage", e.getMessage());
            request.getRequestDispatcher("/WEB-INF/views/registerError.jsp")
                   .forward(request, response);
        }
    }
}
```

**ä¸šåŠ¡é€»è¾‘å±‚ - UserService.java**ï¼š
```java
public class UserService {
    
    private UserDAO userDAO = new UserDAO(); // è°ƒç”¨æ•°æ®å±‚
    
    public User registerUser(String username, String password, String email) 
            throws UserAlreadyExistsException {
        
        // 1. ä¸šåŠ¡è§„åˆ™éªŒè¯ï¼ˆä¸šåŠ¡å±‚èŒè´£ï¼‰
        if (username == null || username.trim().length() < 3) {
            throw new IllegalArgumentException("ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦");
        }
        
        if (password == null || password.length() < 6) {
            throw new IllegalArgumentException("å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦");
        }
        
        // 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
        if (userDAO.findByUsername(username) != null) {
            throw new UserAlreadyExistsException("ç”¨æˆ·åå·²å­˜åœ¨");
        }
        
        // 3. ä¸šåŠ¡å¤„ç†ï¼šå¯†ç åŠ å¯†ï¼ˆä¸šåŠ¡å±‚èŒè´£ï¼‰
        String encryptedPassword = encryptPassword(password);
        
        // 4. åˆ›å»ºç”¨æˆ·å¯¹è±¡
        User user = new User();
        user.setUsername(username);
        user.setPassword(encryptedPassword);
        user.setEmail(email);
        user.setRegisterDate(new Date());
        user.setStatus("ACTIVE");
        
        // 5. ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆè°ƒç”¨æ•°æ®å±‚ï¼‰
        userDAO.save(user);
        
        // 6. è¿”å›ç»“æœ
        return user;
    }
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šå¯†ç åŠ å¯†
    private String encryptPassword(String password) {
        // å®é™…é¡¹ç›®ä¸­ä½¿ç”¨BCryptç­‰å®‰å…¨åŠ å¯†æ–¹å¼
        return password + "_encrypted";
    }
}
```

**æ•°æ®è®¿é—®å±‚ - UserDAO.java**ï¼š
```java
public class UserDAO {
    
    // ä¿å­˜ç”¨æˆ·ï¼ˆæ•°æ®å±‚èŒè´£ï¼šåªç®¡æ•°æ®æ“ä½œï¼‰
    public void save(User user) {
        String sql = "INSERT INTO users (username, password, email, register_date, status) " +
                    "VALUES (?, ?, ?, ?, ?)";
        
        try (Connection conn = DBUtil.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setString(1, user.getUsername());
            ps.setString(2, user.getPassword());
            ps.setString(3, user.getEmail());
            ps.setTimestamp(4, new Timestamp(user.getRegisterDate().getTime()));
            ps.setString(5, user.getStatus());
            
            ps.executeUpdate();
            
        } catch (SQLException e) {
            throw new DataAccessException("ä¿å­˜ç”¨æˆ·å¤±è´¥", e);
        }
    }
    
    // æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ï¼ˆæ•°æ®å±‚èŒè´£ï¼šåªç®¡æ•°æ®æŸ¥è¯¢ï¼‰
    public User findByUsername(String username) {
        String sql = "SELECT * FROM users WHERE username = ?";
        
        try (Connection conn = DBUtil.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setString(1, username);
            ResultSet rs = ps.executeQuery();
            
            if (rs.next()) {
                User user = new User();
                user.setId(rs.getInt("id"));
                user.setUsername(rs.getString("username"));
                user.setPassword(rs.getString("password"));
                user.setEmail(rs.getString("email"));
                user.setRegisterDate(rs.getTimestamp("register_date"));
                user.setStatus(rs.getString("status"));
                return user;
            }
            
        } catch (SQLException e) {
            throw new DataAccessException("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥", e);
        }
        
        return null;
    }
}
```

**è¡¨ç¤ºå±‚ - registerSuccess.jsp**ï¼š
```jsp
<%@ page contentType="text/html;charset=UTF-8" %>

<html>
<head>
    <title>æ³¨å†ŒæˆåŠŸ</title>
    <style>
        .success-message { 
            color: green; 
            font-size: 18px; 
            text-align: center; 
            margin: 50px; 
        }
    </style>
</head>
<body>
    <div class="success-message">
        <h2>ğŸ‰ æ³¨å†ŒæˆåŠŸï¼</h2>
        <p>æ¬¢è¿æ‚¨ï¼Œ<strong>${user.username}</strong>ï¼</p>
        <p>æ‚¨çš„æ³¨å†Œé‚®ç®±ï¼š${user.email}</p>
        <p>æ³¨å†Œæ—¶é—´ï¼š${user.registerDate}</p>
        
        <a href="login.jsp" class="btn">ç«‹å³ç™»å½•</a>
        <a href="index.jsp" class="btn">è¿”å›é¦–é¡µ</a>
    </div>
</body>
</html>
```

---

## 5. âš–ï¸ ä¸šåŠ¡é€»è¾‘åˆ†ç¦»åŸåˆ™


### 5.1 ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ä¸šåŠ¡é€»è¾‘


> âš ï¸ **é‡è¦åŸåˆ™**  
> ä¸šåŠ¡é€»è¾‘åˆ†ç¦»å°±åƒä¸“ä¸šåˆ†å·¥ï¼šè®©ä¸“ä¸šçš„äººåšä¸“ä¸šçš„äº‹ã€‚JSPä¸“å¿ƒåšé¡µé¢å±•ç¤ºï¼ŒServletä¸“å¿ƒåšè¯·æ±‚æ§åˆ¶ï¼ŒServiceä¸“å¿ƒåšä¸šåŠ¡å¤„ç†

**âŒ ä¸åˆ†ç¦»çš„åæœ**ï¼š
```
é—®é¢˜1ï¼šä»£ç æ··ä¹±éš¾ç»´æŠ¤
<%
    // JSPé‡Œå†™äº†ä¸€å¤§å †ä¸šåŠ¡é€»è¾‘
    String username = request.getParameter("username");
    if(username != null) {
        Connection conn = DriverManager.getConnection(...);
        PreparedStatement ps = conn.prepareStatement("SELECT ...");
        // 50è¡Œæ•°æ®åº“æ“ä½œä»£ç 
        // 30è¡Œä¸šåŠ¡è®¡ç®—ä»£ç 
        // 20è¡ŒéªŒè¯é€»è¾‘ä»£ç 
    }
%>
<html>
    <!-- HTMLæ˜¾ç¤ºä»£ç  -->
</html>

ç»“æœï¼šä¸€ä¸ªæ–‡ä»¶100å¤šè¡Œï¼Œæ”¹ä¸ªé¡µé¢æ ·å¼è¦ç¿»éæ‰€æœ‰é€»è¾‘ä»£ç ï¼

é—®é¢˜2ï¼šæ— æ³•é‡ç”¨
åŒæ ·çš„ç”¨æˆ·æ³¨å†Œé€»è¾‘ï¼Œç½‘é¡µç‰ˆå†™ä¸€éï¼Œæ‰‹æœºç‰ˆåˆè¦å†™ä¸€é

é—®é¢˜3ï¼šéš¾ä»¥æµ‹è¯•
é¡µé¢å’Œé€»è¾‘æ··åœ¨ä¸€èµ·ï¼Œæ— æ³•å•ç‹¬æµ‹è¯•ä¸šåŠ¡åŠŸèƒ½

é—®é¢˜4ï¼šå›¢é˜Ÿåä½œå›°éš¾
å‰ç«¯å·¥ç¨‹å¸ˆè¦æ”¹é¡µé¢ï¼Œå¿…é¡»çœ‹æ‡‚åç«¯ä¸šåŠ¡é€»è¾‘ä»£ç 
```

### 5.2 æ­£ç¡®çš„åˆ†ç¦»æ–¹å¼


**âœ… åˆ†ç¦»åçš„æ¸…æ™°ç»“æ„**ï¼š

**èŒè´£æ˜ç¡®çš„åˆ†å·¥**ï¼š
```
JSPçš„èŒè´£ï¼ˆåªç®¡æ˜¾ç¤ºï¼‰ï¼š
â€¢ ä»åŸŸå¯¹è±¡ä¸­å–å‡ºæ•°æ®
â€¢ ç”¨HTMLæ ‡ç­¾ç¾è§‚åœ°å±•ç¤ºæ•°æ®
â€¢ æä¾›ç”¨æˆ·äº¤äº’çš„è¡¨å•å’ŒæŒ‰é’®
â€¢ ç®€å•çš„æ¡ä»¶æ˜¾ç¤ºå’Œå¾ªç¯æ˜¾ç¤º

Servletçš„èŒè´£ï¼ˆè¯·æ±‚æ§åˆ¶ï¼‰ï¼š
â€¢ æ¥æ”¶å’ŒéªŒè¯è¯·æ±‚å‚æ•°
â€¢ è°ƒç”¨Serviceå±‚å¤„ç†ä¸šåŠ¡
â€¢ æ ¹æ®å¤„ç†ç»“æœé€‰æ‹©åˆé€‚çš„é¡µé¢
â€¢ ç®¡ç†è¯·æ±‚è½¬å‘å’Œé‡å®šå‘

Serviceçš„èŒè´£ï¼ˆä¸šåŠ¡å¤„ç†ï¼‰ï¼š
â€¢ å®ç°å…·ä½“çš„ä¸šåŠ¡è§„åˆ™
â€¢ å¤„ç†ä¸šåŠ¡æµç¨‹å’Œè®¡ç®—
â€¢ ç®¡ç†äº‹åŠ¡å’Œå¼‚å¸¸å¤„ç†
â€¢ è°ƒç”¨DAOå±‚è¿›è¡Œæ•°æ®æ“ä½œ

DAOçš„èŒè´£ï¼ˆæ•°æ®æ“ä½œï¼‰ï¼š
â€¢ æ‰§è¡ŒSQLè¯­å¥
â€¢ å¤„ç†æ•°æ®åº“è¿æ¥
â€¢ å°è£…æ•°æ®åº“æ“ä½œç»†èŠ‚
â€¢ å¯¹è±¡å…³ç³»æ˜ å°„
```

### 5.3 åˆ†ç¦»åŸåˆ™çš„å®é™…åº”ç”¨


**ğŸ›’ è´­ç‰©è½¦åŠŸèƒ½çš„åˆ†ç¦»å®ç°**ï¼š

**JSPå±‚ - cart.jspï¼ˆåªè´Ÿè´£æ˜¾ç¤ºï¼‰**ï¼š
```jsp
<%@ page contentType="text/html;charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<html>
<head>
    <title>æˆ‘çš„è´­ç‰©è½¦</title>
</head>
<body>
    <h1>è´­ç‰©è½¦</h1>
    
    <!-- æ˜¾ç¤ºè´­ç‰©è½¦å•†å“ -->
    <c:if test="${empty cartItems}">
        <p>è´­ç‰©è½¦æ˜¯ç©ºçš„ï¼Œ<a href="products">å»è´­ç‰©</a></p>
    </c:if>
    
    <c:if test="${!empty cartItems}">
        <table class="cart-table">
            <thead>
                <tr>
                    <th>å•†å“</th>
                    <th>å•ä»·</th>
                    <th>æ•°é‡</th>
                    <th>å°è®¡</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <c:forEach items="${cartItems}" var="item">
                    <tr>
                        <td>${item.productName}</td>
                        <td>ï¿¥${item.price}</td>
                        <td>
                            <input type="number" value="${item.quantity}" 
                                   min="1" max="99"
                                   onchange="updateQuantity(${item.productId}, this.value)">
                        </td>
                        <td>ï¿¥${item.price * item.quantity}</td>
                        <td>
                            <button onclick="removeItem(${item.productId})">åˆ é™¤</button>
                        </td>
                    </tr>
                </c:forEach>
            </tbody>
        </table>
        
        <!-- æ˜¾ç¤ºæ€»è®¡ï¼ˆServiceå·²è®¡ç®—å¥½ï¼‰ -->
        <div class="cart-summary">
            <p>å•†å“æ€»è®¡ï¼š<strong>ï¿¥${cartTotal}</strong></p>
            <p>è¿è´¹ï¼š<strong>ï¿¥${shippingFee}</strong></p>
            <p>åº”ä»˜æ€»é¢ï¼š<strong>ï¿¥${finalTotal}</strong></p>
            
            <button onclick="checkout()" class="btn-primary">å»ç»“ç®—</button>
        </div>
    </c:if>
</body>
</html>
```

**Servletå±‚ - CartServlet.javaï¼ˆè¯·æ±‚æ§åˆ¶ï¼‰**ï¼š
```java
@WebServlet("/cart")
public class CartServlet extends HttpServlet {
    
    private CartService cartService = new CartService();
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // è·å–å½“å‰ç”¨æˆ·
        User currentUser = (User) request.getSession().getAttribute("currentUser");
        if (currentUser == null) {
            response.sendRedirect("login.jsp");
            return;
        }
        
        // è°ƒç”¨ä¸šåŠ¡å±‚è·å–è´­ç‰©è½¦æ•°æ®
        List<CartItem> cartItems = cartService.getCartItems(currentUser.getId());
        
        // è°ƒç”¨ä¸šåŠ¡å±‚è®¡ç®—æ€»ä»·
        CartTotal cartTotal = cartService.calculateTotal(cartItems);
        
        // å‡†å¤‡æ•°æ®ç»™JSPæ˜¾ç¤º
        request.setAttribute("cartItems", cartItems);
        request.setAttribute("cartTotal", cartTotal.getSubTotal());
        request.setAttribute("shippingFee", cartTotal.getShippingFee());
        request.setAttribute("finalTotal", cartTotal.getFinalTotal());
        
        // è½¬å‘åˆ°JSPé¡µé¢
        request.getRequestDispatcher("/WEB-INF/views/cart.jsp").forward(request, response);
    }
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        String action = request.getParameter("action");
        User currentUser = (User) request.getSession().getAttribute("currentUser");
        
        try {
            switch (action) {
                case "add":
                    int productId = Integer.parseInt(request.getParameter("productId"));
                    int quantity = Integer.parseInt(request.getParameter("quantity"));
                    cartService.addToCart(currentUser.getId(), productId, quantity);
                    break;
                    
                case "update":
                    productId = Integer.parseInt(request.getParameter("productId"));
                    quantity = Integer.parseInt(request.getParameter("quantity"));
                    cartService.updateQuantity(currentUser.getId(), productId, quantity);
                    break;
                    
                case "remove":
                    productId = Integer.parseInt(request.getParameter("productId"));
                    cartService.removeFromCart(currentUser.getId(), productId);
                    break;
            }
            
            // æ“ä½œæˆåŠŸï¼Œé‡å®šå‘å›è´­ç‰©è½¦é¡µé¢
            response.sendRedirect("cart");
            
        } catch (Exception e) {
            // å¤„ç†å¼‚å¸¸
            request.setAttribute("errorMessage", "æ“ä½œå¤±è´¥ï¼š" + e.getMessage());
            doGet(request, response);
        }
    }
}
```

**Serviceå±‚ - CartService.javaï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰**ï¼š
```java
public class CartService {
    
    private CartDAO cartDAO = new CartDAO();
    private ProductDAO productDAO = new ProductDAO();
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šæ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
    public void addToCart(int userId, int productId, int quantity) {
        // 1. ä¸šåŠ¡éªŒè¯
        if (quantity <= 0) {
            throw new IllegalArgumentException("å•†å“æ•°é‡å¿…é¡»å¤§äº0");
        }
        
        // 2. æ£€æŸ¥å•†å“æ˜¯å¦å­˜åœ¨
        Product product = productDAO.findById(productId);
        if (product == null) {
            throw new ProductNotFoundException("å•†å“ä¸å­˜åœ¨");
        }
        
        // 3. æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
        if (product.getStock() < quantity) {
            throw new InsufficientStockException("åº“å­˜ä¸è¶³ï¼Œä»…å‰©" + product.getStock() + "ä»¶");
        }
        
        // 4. æ£€æŸ¥è´­ç‰©è½¦ä¸­æ˜¯å¦å·²æœ‰æ­¤å•†å“
        CartItem existingItem = cartDAO.findByUserAndProduct(userId, productId);
        if (existingItem != null) {
            // å·²å­˜åœ¨ï¼Œæ›´æ–°æ•°é‡
            int newQuantity = existingItem.getQuantity() + quantity;
            if (newQuantity > product.getStock()) {
                throw new InsufficientStockException("è¶…å‡ºåº“å­˜é™åˆ¶");
            }
            cartDAO.updateQuantity(userId, productId, newQuantity);
        } else {
            // ä¸å­˜åœ¨ï¼Œæ–°å¢è®°å½•
            CartItem newItem = new CartItem();
            newItem.setUserId(userId);
            newItem.setProductId(productId);
            newItem.setQuantity(quantity);
            newItem.setPrice(product.getPrice());
            cartDAO.save(newItem);
        }
    }
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šè®¡ç®—è´­ç‰©è½¦æ€»ä»·
    public CartTotal calculateTotal(List<CartItem> cartItems) {
        double subTotal = 0;
        
        // è®¡ç®—å•†å“å°è®¡
        for (CartItem item : cartItems) {
            subTotal += item.getPrice() * item.getQuantity();
        }
        
        // è®¡ç®—è¿è´¹ï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰
        double shippingFee = 0;
        if (subTotal < 199) {
            shippingFee = 15; // 199å…ƒä»¥ä¸‹æ”¶å–15å…ƒè¿è´¹
        }
        
        // åº”ç”¨ä¼˜æƒ åˆ¸ç­‰ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æœæœ‰ï¼‰
        double discount = 0;
        // ... ä¼˜æƒ åˆ¸è®¡ç®—é€»è¾‘
        
        CartTotal total = new CartTotal();
        total.setSubTotal(subTotal);
        total.setShippingFee(shippingFee);
        total.setDiscount(discount);
        total.setFinalTotal(subTotal + shippingFee - discount);
        
        return total;
    }
    
    // è·å–ç”¨æˆ·è´­ç‰©è½¦å•†å“
    public List<CartItem> getCartItems(int userId) {
        return cartDAO.findByUserId(userId);
    }
}
```

### 5.4 åˆ†ç¦»çš„å…·ä½“å¥½å¤„


**ğŸ¯ å®é™…å¼€å‘ä¸­çš„å¥½å¤„å¯¹æ¯”**ï¼š

| æ–¹é¢ | **åˆ†ç¦»å‰** | **åˆ†ç¦»å** |
|------|-----------|-----------|
| ğŸ”§ **ç»´æŠ¤æ€§** | æ”¹ä¸ªé¡µé¢è¦ç¿»100è¡Œæ··åˆä»£ç  | æ”¹é¡µé¢åªçœ‹JSPï¼Œæ”¹ä¸šåŠ¡åªçœ‹Service |
| ğŸ”„ **å¤ç”¨æ€§** | æ¯ä¸ªé¡µé¢é‡å†™ç›¸åŒä¸šåŠ¡é€»è¾‘ | ä¸€ä¸ªServiceå¯ä¾›å¤šä¸ªServletä½¿ç”¨ |
| ğŸ§ª **æµ‹è¯•æ€§** | å¿…é¡»å¯åŠ¨æ•´ä¸ªWebé¡¹ç›®æ‰èƒ½æµ‹è¯• | Serviceå¯ä»¥ç‹¬ç«‹è¿›è¡Œå•å…ƒæµ‹è¯• |
| ğŸ‘¥ **åä½œæ€§** | å‰ç«¯åç«¯äº’ç›¸ç­‰å¾…ï¼Œæ— æ³•å¹¶è¡Œå¼€å‘ | å®šä¹‰å¥½æ¥å£åå¯ä»¥å¹¶è¡Œå¼€å‘ |
| ğŸ› **è°ƒè¯•æ€§** | é”™è¯¯å¯èƒ½å‡ºç°åœ¨ä»»ä½•åœ°æ–¹ | æ ¹æ®å¼‚å¸¸ç±»å‹å¿«é€Ÿå®šä½é—®é¢˜å±‚æ¬¡ |

---

## 6. ğŸš€ ç»¼åˆå®è·µæ¡ˆä¾‹


### 6.1 æ¡ˆä¾‹èƒŒæ™¯ï¼šåœ¨çº¿å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ


> ğŸ“š **é¡¹ç›®æè¿°**  
> å¼€å‘ä¸€ä¸ªç®€å•çš„åœ¨çº¿å›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«å›¾ä¹¦åˆ—è¡¨å±•ç¤ºã€å›¾ä¹¦è¯¦æƒ…æŸ¥çœ‹ã€å›¾ä¹¦å€Ÿé˜…åŠŸèƒ½ã€‚é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹å®Œæ•´æ¼”ç¤ºMVCæ¨¡å¼çš„åº”ç”¨

**åŠŸèƒ½éœ€æ±‚**ï¼š
- ğŸ“– å›¾ä¹¦åˆ—è¡¨æ˜¾ç¤ºï¼ˆåˆ†é¡µï¼‰
- ğŸ” å›¾ä¹¦æœç´¢åŠŸèƒ½  
- ğŸ“‹ å›¾ä¹¦è¯¦æƒ…æŸ¥çœ‹
- ğŸ“š å›¾ä¹¦å€Ÿé˜…/å½’è¿˜

### 6.2 å®Œæ•´çš„MVCå®ç°


**ğŸ“Š æ•°æ®åº“è®¾è®¡**ï¼š
```sql
-- å›¾ä¹¦è¡¨
CREATE TABLE books (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    author VARCHAR(100) NOT NULL,
    category VARCHAR(50) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    stock INT NOT NULL DEFAULT 0,
    description TEXT,
    create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å€Ÿé˜…è®°å½•è¡¨
CREATE TABLE borrow_records (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    book_id INT NOT NULL,
    borrow_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    return_date TIMESTAMP NULL,
    status VARCHAR(20) DEFAULT 'BORROWED'
);
```

**ğŸ—ï¸ é¡¹ç›®ç»“æ„**ï¼š
```
src/
â”œâ”€â”€ controller/          # æ§åˆ¶å±‚
â”‚   â”œâ”€â”€ BookListServlet.java
â”‚   â”œâ”€â”€ BookDetailServlet.java
â”‚   â””â”€â”€ BorrowBookServlet.java
â”œâ”€â”€ service/            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ BookService.java
â”‚   â””â”€â”€ BorrowService.java
â”œâ”€â”€ dao/                # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ BookDAO.java
â”‚   â””â”€â”€ BorrowRecordDAO.java
â”œâ”€â”€ model/              # å®ä½“ç±»
â”‚   â”œâ”€â”€ Book.java
â”‚   â”œâ”€â”€ BorrowRecord.java
â”‚   â””â”€â”€ PageInfo.java
â””â”€â”€ util/               # å·¥å…·ç±»
    â””â”€â”€ DBUtil.java

webapp/
â”œâ”€â”€ WEB-INF/views/      # JSPé¡µé¢
â”‚   â”œâ”€â”€ bookList.jsp
â”‚   â”œâ”€â”€ bookDetail.jsp
â”‚   â””â”€â”€ borrowSuccess.jsp
â”œâ”€â”€ css/
â”œâ”€â”€ js/
â””â”€â”€ index.jsp
```

**ğŸ“‹ å®ä½“ç±» - Book.java**ï¼š
```java
public class Book {
    private int id;
    private String title;
    private String author;
    private String category;
    private double price;
    private int stock;
    private String description;
    private Date createDate;
    
    // æ„é€ æ–¹æ³•
    public Book() {}
    
    // getterå’Œsetteræ–¹æ³•
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }
    
    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }
    
    // ... å…¶ä»–getter/setteræ–¹æ³•
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šåˆ¤æ–­æ˜¯å¦æœ‰åº“å­˜
    public boolean hasStock() {
        return stock > 0;
    }
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šè·å–åº“å­˜çŠ¶æ€æè¿°
    public String getStockStatus() {
        if (stock > 10) return "åº“å­˜å……è¶³";
        if (stock > 0) return "åº“å­˜ç´§å¼ ";
        return "æš‚æ— åº“å­˜";
    }
}
```

**ğŸ® æ§åˆ¶å±‚ - BookListServlet.java**ï¼š
```java
@WebServlet("/books")
public class BookListServlet extends HttpServlet {
    
    private BookService bookService = new BookService();
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        try {
            // 1. è·å–è¯·æ±‚å‚æ•°
            String category = request.getParameter("category");
            String keyword = request.getParameter("keyword");
            String pageStr = request.getParameter("page");
            
            // å‚æ•°å¤„ç†å’Œé»˜è®¤å€¼è®¾ç½®
            int currentPage = 1;
            if (pageStr != null && !pageStr.isEmpty()) {
                currentPage = Integer.parseInt(pageStr);
            }
            int pageSize = 10; // æ¯é¡µæ˜¾ç¤º10æœ¬ä¹¦
            
            // 2. è°ƒç”¨ä¸šåŠ¡å±‚è·å–æ•°æ®
            List<Book> bookList;
            int totalCount;
            
            if (keyword != null && !keyword.trim().isEmpty()) {
                // æœç´¢åŠŸèƒ½
                bookList = bookService.searchBooks(keyword.trim(), currentPage, pageSize);
                totalCount = bookService.getSearchCount(keyword.trim());
            } else if (category != null && !category.isEmpty()) {
                // åˆ†ç±»æµè§ˆ
                bookList = bookService.getBooksByCategory(category, currentPage, pageSize);
                totalCount = bookService.getCategoryCount(category);
            } else {
                // è·å–æ‰€æœ‰å›¾ä¹¦
                bookList = bookService.getAllBooks(currentPage, pageSize);
                totalCount = bookService.getTotalCount();
            }
            
            // 3. è®¡ç®—åˆ†é¡µä¿¡æ¯
            int totalPages = (int) Math.ceil((double) totalCount / pageSize);
            
            // 4. å‡†å¤‡æ•°æ®ä¼ ç»™JSP
            request.setAttribute("bookList", bookList);
            request.setAttribute("currentPage", currentPage);
            request.setAttribute("totalPages", totalPages);
            request.setAttribute("totalCount", totalCount);
            request.setAttribute("category", category);
            request.setAttribute("keyword", keyword);
            
            // 5. è·å–æ‰€æœ‰åˆ†ç±»ä¾›å¯¼èˆªä½¿ç”¨
            List<String> categories = bookService.getAllCategories();
            request.setAttribute("categories", categories);
            
            // 6. è½¬å‘åˆ°JSPé¡µé¢
            request.getRequestDispatcher("/WEB-INF/views/bookList.jsp")
                   .forward(request, response);
                   
        } catch (Exception e) {
            // å¼‚å¸¸å¤„ç†
            request.setAttribute("errorMessage", "è·å–å›¾ä¹¦åˆ—è¡¨å¤±è´¥ï¼š" + e.getMessage());
            request.getRequestDispatcher("/WEB-INF/views/error.jsp")
                   .forward(request, response);
        }
    }
}
```

**ğŸ­ è§†å›¾å±‚ - bookList.jsp**ï¼š
```jsp
<%@ page contentType="text/html;charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<html>
<head>
    <title>å›¾ä¹¦åˆ—è¡¨</title>
    <style>
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .search-bar { margin-bottom: 20px; text-align: center; }
        .category-nav { margin-bottom: 20px; }
        .book-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .book-card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
        .pagination { text-align: center; margin-top: 30px; }
        .page-link { margin: 0 5px; padding: 8px 12px; text-decoration: none; }
        .current-page { background-color: #007bff; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š åœ¨çº¿å›¾ä¹¦é¦†</h1>
        
        <!-- æœç´¢æ  -->
        <div class="search-bar">
            <form method="get" action="books">
                <input type="text" name="keyword" value="${keyword}" 
                       placeholder="è¯·è¾“å…¥å›¾ä¹¦åç§°æˆ–ä½œè€…..." size="30">
                <button type="submit">ğŸ” æœç´¢</button>
                <c:if test="${!empty keyword}">
                    <a href="books">æ¸…é™¤æœç´¢</a>
                </c:if>
            </form>
        </div>
        
        <!-- åˆ†ç±»å¯¼èˆª -->
        <div class="category-nav">
            <strong>åˆ†ç±»æµè§ˆï¼š</strong>
            <a href="books" class="${empty category ? 'current' : ''}">å…¨éƒ¨</a>
            <c:forEach items="${categories}" var="cat">
                <a href="books?category=${cat}" 
                   class="${category eq cat ? 'current' : ''}">${cat}</a>
            </c:forEach>
        </div>
        
        <!-- ç»“æœç»Ÿè®¡ -->
        <div class="result-info">
            <c:choose>
                <c:when test="${!empty keyword}">
                    <p>æœç´¢"<strong>${keyword}</strong>"ï¼Œå…±æ‰¾åˆ° <strong>${totalCount}</strong> æœ¬å›¾ä¹¦</p>
                </c:when>
                <c:when test="${!empty category}">
                    <p><strong>${category}</strong> åˆ†ç±»ï¼Œå…± <strong>${totalCount}</strong> æœ¬å›¾ä¹¦</p>
                </c:when>
                <c:otherwise>
                    <p>å›¾ä¹¦æ€»è®¡ï¼š<strong>${totalCount}</strong> æœ¬</p>
                </c:otherwise>
            </c:choose>
        </div>
        
        <!-- å›¾ä¹¦åˆ—è¡¨ -->
        <c:if test="${empty bookList}">
            <div style="text-align: center; margin: 50px;">
                <p>ğŸ˜” æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å›¾ä¹¦</p>
                <a href="books">æµè§ˆæ‰€æœ‰å›¾ä¹¦</a>
            </div>
        </c:if>
        
        <c:if test="${!empty bookList}">
            <div class="book-grid">
                <c:forEach items="${bookList}" var="book">
                    <div class="book-card">
                        <h3><a href="bookDetail?id=${book.id}">${book.title}</a></h3>
                        <p><strong>ä½œè€…ï¼š</strong>${book.author}</p>
                        <p><strong>åˆ†ç±»ï¼š</strong>${book.category}</p>
                        <p><strong>ä»·æ ¼ï¼š</strong>ï¿¥<fmt:formatNumber value="${book.price}" pattern="#,##0.00"/></p>
                        
                        <!-- åº“å­˜çŠ¶æ€æ˜¾ç¤º -->
                        <p><strong>çŠ¶æ€ï¼š</strong>
                            <c:choose>
                                <c:when test="${book.stock > 10}">
                                    <span style="color: green;">âœ… ${book.stockStatus}</span>
                                </c:when>
                                <c:when test="${book.stock > 0}">
                                    <span style="color: orange;">âš ï¸ ${book.stockStatus}</span>
                                </c:when>
                                <c:otherwise>
                                    <span style="color: red;">âŒ ${book.stockStatus}</span>
                                </c:otherwise>
                            </c:choose>
                        </p>
                        
                        <!-- æ“ä½œæŒ‰é’® -->
                        <div style="margin-top: 10px;">
                            <a href="bookDetail?id=${book.id}" class="btn">æŸ¥çœ‹è¯¦æƒ…</a>
                            <c:if test="${book.hasStock()}">
                                <button onclick="borrowBook(${book.id})" class="btn-primary">ç«‹å³å€Ÿé˜…</button>
                            </c:if>
                        </div>
                    </div>
                </c:forEach>
            </div>
            
            <!-- åˆ†é¡µå¯¼èˆª -->
            <c:if test="${totalPages > 1}">
                <div class="pagination">
                    <!-- ä¸Šä¸€é¡µ -->
                    <c:if test="${currentPage > 1}">
                        <a href="books?page=${currentPage-1}&category=${category}&keyword=${keyword}" 
                           class="page-link">â€¹ ä¸Šä¸€é¡µ</a>
                    </c:if>
                    
                    <!-- é¡µç  -->
                    <c:forEach var="i" begin="1" end="${totalPages}">
                        <c:choose>
                            <c:when test="${i == currentPage}">
                                <span class="page-link current-page">${i}</span>
                            </c:when>
                            <c:otherwise>
                                <a href="books?page=${i}&category=${category}&keyword=${keyword}" 
                                   class="page-link">${i}</a>
                            </c:otherwise>
                        </c:choose>
                    </c:forEach>
                    
                    <!-- ä¸‹ä¸€é¡µ -->
                    <c:if test="${currentPage < totalPages}">
                        <a href="books?page=${currentPage+1}&category=${category}&keyword=${keyword}" 
                           class="page-link">ä¸‹ä¸€é¡µ â€º</a>
                    </c:if>
                </div>
            </c:if>
        </c:if>
    </div>
    
    <script>
        // å€Ÿé˜…å›¾ä¹¦çš„JavaScriptå‡½æ•°
        function borrowBook(bookId) {
            if (confirm('ç¡®å®šè¦å€Ÿé˜…è¿™æœ¬ä¹¦å—ï¼Ÿ')) {
                // å‘é€å€Ÿé˜…è¯·æ±‚
                window.location.href = 'borrowBook?bookId=' + bookId;
            }
        }
    </script>
</body>
</html>
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ MVCæ¨¡å¼ï¼šModel-View-Controllerï¼Œåˆ†ç¦»æ•°æ®ã€è§†å›¾ã€æ§åˆ¶é€»è¾‘
ğŸ”¸ JSPè§’è‰²ï¼šåœ¨MVCä¸­ä¸“èŒè´Ÿè´£Viewå±‚ï¼Œåªåšé¡µé¢å±•ç¤º
ğŸ”¸ åä½œæ¨¡å¼ï¼šServletå¤„ç†è¯·æ±‚â†’è°ƒç”¨Serviceâ†’å‡†å¤‡æ•°æ®â†’è½¬å‘JSPâ†’æ˜¾ç¤ºé¡µé¢
ğŸ”¸ ä¸‰å±‚æ¶æ„ï¼šè¡¨ç¤ºå±‚(JSP+Servlet)ã€ä¸šåŠ¡å±‚(Service)ã€æ•°æ®å±‚(DAO)
ğŸ”¸ åˆ†ç¦»åŸåˆ™ï¼šå„å±‚èŒè´£æ˜ç¡®ï¼Œä¸šåŠ¡é€»è¾‘ä¸å†™åœ¨JSPä¸­
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ JSPçš„æ­£ç¡®å®šä½**
```
âœ… JSPåº”è¯¥åšçš„ï¼š
- æ˜¾ç¤ºServletå‡†å¤‡å¥½çš„æ•°æ®
- æä¾›ç”¨æˆ·äº¤äº’ç•Œé¢
- ç®€å•çš„æ ¼å¼åŒ–å’Œæ¡ä»¶æ˜¾ç¤º
- é¡µé¢å¸ƒå±€å’Œæ ·å¼ç¾åŒ–

âŒ JSPä¸åº”è¯¥åšçš„ï¼š
- è¿æ¥æ•°æ®åº“è¿›è¡ŒCRUDæ“ä½œ
- å¤æ‚çš„ä¸šåŠ¡é€»è¾‘è®¡ç®—
- å¤æ‚çš„æ•°æ®éªŒè¯
- å¤æ‚çš„æµç¨‹æ§åˆ¶
```

**ğŸ”¹ æ•°æ®ä¼ é€’çš„ç†è§£**
```
æ•°æ®æµå‘ï¼š
æ•°æ®åº“ â†’ DAO â†’ Service â†’ Servlet â†’ JSP â†’ ç”¨æˆ·

ä¼ é€’æ–¹å¼ï¼š
â€¢ request.setAttribute() - å•æ¬¡è¯·æ±‚æ•°æ®
â€¢ session.setAttribute() - ä¼šè¯æœŸé—´æ•°æ®  
â€¢ application.setAttribute() - å…¨å±€å…±äº«æ•°æ®
```

**ğŸ”¹ åˆ†å±‚çš„å¥½å¤„**
```
ç»´æŠ¤æ€§ï¼šä¿®æ”¹æŸä¸€å±‚ä¸å½±å“å…¶ä»–å±‚
æ‰©å±•æ€§ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°åŠŸèƒ½
æµ‹è¯•æ€§ï¼šæ¯ä¸€å±‚éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
å¤ç”¨æ€§ï¼šä¸šåŠ¡é€»è¾‘å¯ä»¥è¢«å¤šä¸ªåœ°æ–¹è°ƒç”¨
åä½œæ€§ï¼šå›¢é˜Ÿæˆå‘˜å¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒå±‚æ¬¡
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å¼€å‘å»ºè®®**ï¼š
```
1. å…ˆè®¾è®¡æ•°æ®åº“å’Œå®ä½“ç±»
2. ç¼–å†™DAOå±‚ï¼Œæµ‹è¯•æ•°æ®æ“ä½œ
3. ç¼–å†™Serviceå±‚ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘
4. ç¼–å†™Servletï¼Œå¤„ç†è¯·æ±‚æ§åˆ¶
5. æœ€åç¼–å†™JSPï¼Œä¸“æ³¨é¡µé¢å±•ç¤º

è®°å¿†å£è¯€ï¼š
æ•°æ®å…ˆè¡Œå®šç»“æ„ï¼ŒDAOè´Ÿè´£å­˜å–æ•°æ®åº“
Serviceå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ŒServletæ§åˆ¶è¯·æ±‚åˆ†å‘
JSPä¸“å¿ƒåšå±•ç¤ºï¼Œåˆ†å·¥æ˜ç¡®å¥½ç»´æŠ¤
```

**ğŸ“ æ£€éªŒæ¸…å•**ï¼š
```
âœ… è‡ªæ£€è¦ç‚¹ï¼š
- [ ] JSPä¸­æ²¡æœ‰æ•°æ®åº“è¿æ¥ä»£ç 
- [ ] JSPä¸­æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡è®¡ç®—
- [ ] Servletåªåšè¯·æ±‚æ§åˆ¶ï¼Œä¸ç›´æ¥æ“ä½œæ•°æ®åº“
- [ ] Serviceå°è£…äº†å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘
- [ ] DAOåªè´Ÿè´£æ•°æ®è®¿é—®ï¼Œä¸åŒ…å«ä¸šåŠ¡è§„åˆ™
- [ ] å„å±‚èŒè´£æ¸…æ™°ï¼Œæ²¡æœ‰è·¨å±‚è°ƒç”¨
```

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³**ï¼š
```
é—®é¢˜1ï¼šJSPé¡µé¢æ˜¾ç¤ºç©ºç™½
è§£å†³ï¼šæ£€æŸ¥Servletæ˜¯å¦æ­£ç¡®è®¾ç½®äº†requestå±æ€§

é—®é¢˜2ï¼šæ•°æ®æ²¡æœ‰æ­£ç¡®æ˜¾ç¤º
è§£å†³ï¼šæ£€æŸ¥ELè¡¨è¾¾å¼çš„å±æ€§åæ˜¯å¦ä¸setAttributeçš„keyä¸€è‡´

é—®é¢˜3ï¼šé¡µé¢é€»è¾‘å¤æ‚éš¾ç»´æŠ¤
è§£å†³ï¼šå°†å¤æ‚é€»è¾‘ç§»åˆ°Serviceå±‚ï¼ŒJSPåªåšç®€å•æ˜¾ç¤º

é—®é¢˜4ï¼šä»£ç é‡å¤ä¸¥é‡
è§£å†³ï¼šæå–å…¬å…±ä¸šåŠ¡é€»è¾‘åˆ°Serviceå±‚ï¼Œå¤šä¸ªServletå…±ç”¨
```

### 7.4 è¿›ä¸€æ­¥å­¦ä¹ æ–¹å‘


```
ğŸš€ åç»­å­¦ä¹ è·¯å¾„ï¼š
1. å­¦ä¹ æ›´å¤šJSPæ ‡ç­¾åº“(JSTL)çš„ä½¿ç”¨
2. æŒæ¡è¿‡æ»¤å™¨(Filter)å’Œç›‘å¬å™¨(Listener)
3. å­¦ä¹ Spring MVCæ¡†æ¶ï¼ˆæ›´å¼ºå¤§çš„MVCå®ç°ï¼‰
4. äº†è§£å‰åç«¯åˆ†ç¦»å¼€å‘æ¨¡å¼
5. å­¦ä¹ RESTful APIè®¾è®¡

ğŸ’¡ å®è·µå»ºè®®ï¼š
- å¤šåšå®Œæ•´çš„å°é¡¹ç›®å·©å›ºMVCç†è§£
- å°è¯•ä¸åŒç±»å‹çš„ä¸šåŠ¡åœºæ™¯
- å­¦ä¼šä½¿ç”¨å¼€å‘å·¥å…·è¿›è¡Œè°ƒè¯•
- å…³æ³¨ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
```

**æ ¸å¿ƒè®°å¿†**ï¼š
> ğŸ¯ **ä¸€å¥è¯æ€»ç»“**  
> MVCæ¨¡å¼è®©JSPä¸“å¿ƒåšå±•ç¤ºï¼ŒServletä¸“å¿ƒåšæ§åˆ¶ï¼ŒServiceä¸“å¿ƒåšä¸šåŠ¡ï¼Œå°±åƒä¸“ä¸šå›¢é˜Ÿåˆ†å·¥åä½œï¼Œå„å¸å…¶èŒæ•ˆç‡é«˜ï¼