---
title: 3ã€ä¼šè¯ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-ä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [HttpSessionå¯¹è±¡æ“ä½œ](#2-HttpSessionå¯¹è±¡æ“ä½œ)
3. [Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†](#3-Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†)
4. [Cookieæœºåˆ¶åŸç†](#4-Cookieæœºåˆ¶åŸç†)
5. [URLé‡å†™æŠ€æœ¯](#5-URLé‡å†™æŠ€æœ¯)
6. [ä¼šè¯è¶…æ—¶è®¾ç½®](#6-ä¼šè¯è¶…æ—¶è®¾ç½®)
7. [å®æˆ˜åº”ç”¨æ¡ˆä¾‹](#7-å®æˆ˜åº”ç”¨æ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ä¼šè¯ç®¡ç†


**ğŸ”¸ ç®€å•ç†è§£**
æƒ³è±¡ä½ å»é“¶è¡ŒåŠäº‹ï¼ŒæŸœå‘˜éœ€è¦è®°ä½ä½ æ˜¯è°ã€ä½ è¦åŠä»€ä¹ˆä¸šåŠ¡ã€‚ä½†HTTPåè®®å°±åƒ"å¥å¿˜ç—‡æ‚£è€…"ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¸è®°å¾—ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆã€‚

```
æ²¡æœ‰ä¼šè¯ç®¡ç†çš„æƒ…å†µï¼š
ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢ â†’ æœåŠ¡å™¨å“åº”
ç”¨æˆ·æäº¤ç™»å½•è¡¨å• â†’ æœåŠ¡å™¨éªŒè¯ï¼ˆä½†ä¸è®°å¾—ç”¨æˆ·ï¼‰
ç”¨æˆ·è®¿é—®ä¸ªäººä¸­å¿ƒ â†’ æœåŠ¡å™¨ä¸çŸ¥é“ç”¨æˆ·å·²ç™»å½• âŒ
```

**ğŸ’¡ ä¼šè¯çš„æœ¬è´¨**
```
ä¼šè¯ = ç”¨æˆ·ä¸æœåŠ¡å™¨çš„ä¸€ç³»åˆ—ç›¸å…³äº¤äº’
ç›®çš„ï¼šè®©æœåŠ¡å™¨"è®°ä½"ç”¨æˆ·çš„çŠ¶æ€å’Œä¿¡æ¯
å®ç°ï¼šé€šè¿‡æŠ€æœ¯æ‰‹æ®µåœ¨æ— çŠ¶æ€çš„HTTPä¸Šæ„å»ºæœ‰çŠ¶æ€çš„äº¤äº’
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯ç®¡ç†


**ğŸ”¸ HTTPåè®®çš„ç‰¹ç‚¹**
```
æ— çŠ¶æ€æ€§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    è¯·æ±‚1    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯  â”‚ ---------> â”‚  æœåŠ¡å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚       å“åº”1           â”‚
     â”‚ <----------           â”‚
     â”‚                      â”‚ (å¿˜è®°äº†è¯·æ±‚1çš„ä¿¡æ¯)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    è¯·æ±‚2    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯  â”‚ ---------> â”‚  æœåŠ¡å™¨  â”‚ (ä¸çŸ¥é“è¿™æ˜¯åŒä¸€ä¸ªç”¨æˆ·)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ å®é™…åº”ç”¨éœ€æ±‚**
- **ğŸ›’ è´­ç‰©è½¦åŠŸèƒ½**ï¼šè®°ä½ç”¨æˆ·é€‰æ‹©çš„å•†å“
- **ğŸ‘¤ ç”¨æˆ·ç™»å½•**ï¼šè®°ä½ç”¨æˆ·çš„ç™»å½•çŠ¶æ€
- **ğŸ“Š ä¸ªæ€§åŒ–æ¨è**ï¼šæ ¹æ®ç”¨æˆ·å†å²è¡Œä¸ºæ¨è
- **ğŸ¨ ç•Œé¢å®šåˆ¶**ï¼šè®°ä½ç”¨æˆ·çš„ç•Œé¢è®¾ç½®

### 1.3 ä¼šè¯ç®¡ç†çš„å®ç°æ–¹å¼


```
å¸¸è§çš„ä¼šè¯ç®¡ç†æŠ€æœ¯ï¼š

ğŸ“Š æŠ€æœ¯å¯¹æ¯”è¡¨æ ¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æŠ€æœ¯     â”‚   å­˜å‚¨ä½ç½®   â”‚   å®‰å…¨æ€§    â”‚   ä½¿ç”¨åœºæ™¯   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Cookie    â”‚   å®¢æˆ·ç«¯    â”‚     è¾ƒä½    â”‚  ç®€å•æ•°æ®   â”‚
â”‚   Session   â”‚   æœåŠ¡ç«¯    â”‚     è¾ƒé«˜    â”‚  æ•æ„Ÿæ•°æ®   â”‚
â”‚ URLé‡å†™     â”‚    URLä¸­    â”‚     æœ€ä½    â”‚  å¤‡ç”¨æ–¹æ¡ˆ   â”‚
â”‚ éšè—åŸŸ      â”‚   è¡¨å•ä¸­    â”‚     è¾ƒä½    â”‚  è¡¨å•ä¼ é€’   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”§ HttpSessionå¯¹è±¡æ“ä½œ


### 2.1 HttpSessionå¯¹è±¡æ¦‚è¿°


**ğŸ”¸ ä»€ä¹ˆæ˜¯HttpSession**

> **HttpSession**å°±åƒæœåŠ¡å™¨ä¸ºæ¯ä¸ªç”¨æˆ·å‡†å¤‡çš„"ä¸“å±æ¡£æ¡ˆè¢‹"ï¼Œé‡Œé¢å¯ä»¥å­˜æ”¾è¿™ä¸ªç”¨æˆ·çš„å„ç§ä¿¡æ¯ã€‚

```java
// JSPä¸­è·å–Sessionå¯¹è±¡éå¸¸ç®€å•
<%
    HttpSession session = request.getSession();
    // æ³¨æ„ï¼šJSPä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å†…ç½®å¯¹è±¡ session
%>
```

**ğŸ’¡ Sessionå·¥ä½œåŸç†å›¾**
```
ç”¨æˆ·é¦–æ¬¡è®¿é—®ï¼š
å®¢æˆ·ç«¯                     æœåŠ¡å™¨
  â”‚                         â”‚
  â”‚â”€â”€â”€â”€ é¦–æ¬¡è¯·æ±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                         â”‚ åˆ›å»ºSessionå¯¹è±¡
  â”‚                         â”‚ ç”ŸæˆSessionID
  â”‚â†â”€â”€ å“åº”+SessionID â”€â”€â”€â”€â”€â”€â”‚
  â”‚    (é€šè¿‡Cookieå‘é€)      â”‚

åç»­è®¿é—®ï¼š
  â”‚â”€â”€â”€â”€ è¯·æ±‚+SessionID â”€â”€â”€â”€â”€â†’â”‚
  â”‚                         â”‚ æ ¹æ®SessionIDæ‰¾åˆ°å¯¹åº”Session
  â”‚â†â”€â”€â”€ å“åº” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 2.2 Sessionå¸¸ç”¨æ–¹æ³•


**ğŸ”¸ å­˜å‚¨å’Œè·å–æ•°æ®**

```jsp
<%
// âœ… å­˜å‚¨æ•°æ®åˆ°Session
session.setAttribute("username", "å¼ ä¸‰");
session.setAttribute("loginTime", new Date());
session.setAttribute("shoppingCart", cartList);

// âœ… ä»Sessionè·å–æ•°æ®
String username = (String) session.getAttribute("username");
Date loginTime = (Date) session.getAttribute("loginTime");

// âœ… å®‰å…¨çš„è·å–æ•°æ®ï¼ˆé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼‰
if (session.getAttribute("username") != null) {
    String user = (String) session.getAttribute("username");
    out.println("æ¬¢è¿ï¼Œ" + user);
} else {
    out.println("è¯·å…ˆç™»å½•");
}
%>
```

**ğŸ”¸ Sessionä¿¡æ¯æŸ¥è¯¢**

```jsp
<%
// ğŸ“‹ è·å–SessionåŸºæœ¬ä¿¡æ¯
String sessionId = session.getId();                    // Sessionå”¯ä¸€æ ‡è¯†
long createTime = session.getCreationTime();           // åˆ›å»ºæ—¶é—´
long lastAccessTime = session.getLastAccessedTime();   // æœ€åè®¿é—®æ—¶é—´
int maxInactiveInterval = session.getMaxInactiveInterval(); // è¶…æ—¶æ—¶é—´

// ğŸ“Š æ˜¾ç¤ºSessionä¿¡æ¯
out.println("<h3>Sessionä¿¡æ¯</h3>");
out.println("Session ID: " + sessionId + "<br>");
out.println("åˆ›å»ºæ—¶é—´: " + new Date(createTime) + "<br>");
out.println("æœ€åè®¿é—®: " + new Date(lastAccessTime) + "<br>");
out.println("è¶…æ—¶è®¾ç½®: " + maxInactiveInterval + "ç§’<br>");
%>
```

### 2.3 å®ç”¨çš„Sessionæ“ä½œæŠ€å·§


**ğŸ”¸ æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨**

```jsp
<%
// ğŸ” æ–¹æ³•1ï¼šç›´æ¥æ£€æŸ¥
if (session.getAttribute("user") != null) {
    // ç”¨æˆ·å·²ç™»å½•çš„å¤„ç†é€»è¾‘
}

// ğŸ” æ–¹æ³•2ï¼šè·å–æ‰€æœ‰å±æ€§å
java.util.Enumeration<String> attrNames = session.getAttributeNames();
while (attrNames.hasMoreElements()) {
    String attrName = attrNames.nextElement();
    out.println(attrName + " = " + session.getAttribute(attrName) + "<br>");
}
%>
```

**ğŸ”¸ åˆ é™¤Sessionæ•°æ®**

```jsp
<%
// âŒ åˆ é™¤ç‰¹å®šå±æ€§
session.removeAttribute("tempData");

// ğŸ—‘ï¸ æ¸…é™¤æ•´ä¸ªSessionï¼ˆç”¨æˆ·é€€å‡ºç™»å½•ï¼‰
session.invalidate();
%>
```

---

## 3. â° Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†


### 3.1 Sessionçš„ç”Ÿå‘½å‘¨æœŸ


**ğŸ”¸ Sessionç”Ÿå‘½å‘¨æœŸå›¾ç¤º**

```
Sessionç”Ÿå‘½å‘¨æœŸï¼š
åˆ›å»º â†’ ä½¿ç”¨ â†’ è¶…æ—¶/é”€æ¯

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   é¦–æ¬¡è®¿é—®   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   æŒç»­ä½¿ç”¨   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸å­˜åœ¨  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   æ´»è·ƒ   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   æ´»è·ƒ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                       â”‚
                              â”‚ è¶…æ—¶                   â”‚ æ‰‹åŠ¨é”€æ¯
                              â†“                       â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   é”€æ¯   â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   é”€æ¯   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Sessionåˆ›å»ºæ—¶æœº


**ğŸ”¸ è‡ªåŠ¨åˆ›å»ºSession**

```jsp
<%
// ä»¥ä¸‹æ“ä½œä¼šè‡ªåŠ¨åˆ›å»ºSessionï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
HttpSession session = request.getSession();        // è·å–æˆ–åˆ›å»º
HttpSession session = request.getSession(true);    // åŒä¸Š

// ä»…è·å–å·²å­˜åœ¨çš„Sessionï¼Œä¸åˆ›å»ºæ–°çš„
HttpSession session = request.getSession(false);   // å¯èƒ½è¿”å›null
%>
```

**ğŸ’¡ æœ€ä½³å®è·µç¤ºä¾‹**

```jsp
<%
// âœ… å®‰å…¨çš„Sessionè·å–æ–¹å¼
HttpSession userSession = request.getSession(false);

if (userSession == null) {
    // Sessionä¸å­˜åœ¨ï¼Œç”¨æˆ·æœªç™»å½•
    response.sendRedirect("login.jsp");
} else {
    // Sessionå­˜åœ¨ï¼Œæ£€æŸ¥ç™»å½•çŠ¶æ€
    String username = (String) userSession.getAttribute("username");
    if (username == null) {
        // Sessionå­˜åœ¨ä½†ç”¨æˆ·æœªç™»å½•
        response.sendRedirect("login.jsp");
    } else {
        // ç”¨æˆ·å·²ç™»å½•ï¼Œç»§ç»­æ­£å¸¸æµç¨‹
        out.println("æ¬¢è¿å›æ¥ï¼Œ" + username);
    }
}
%>
```

### 3.3 Sessioné”€æ¯æ¡ä»¶


**ğŸ“‹ Sessioné”€æ¯çš„ä¸‰ç§æƒ…å†µ**

| é”€æ¯æ–¹å¼ | **è§¦å‘æ¡ä»¶** | **ä½¿ç”¨åœºæ™¯** | **ä»£ç ç¤ºä¾‹** |
|----------|-------------|--------------|--------------|
| **ğŸ• è¶…æ—¶é”€æ¯** | `è¶…è¿‡æœ€å¤§éæ´»è·ƒæ—¶é—´` | `ç”¨æˆ·é•¿æ—¶é—´æœªæ“ä½œ` | `è‡ªåŠ¨è§¦å‘` |
| **ğŸ”§ æ‰‹åŠ¨é”€æ¯** | `è°ƒç”¨invalidate()æ–¹æ³•` | `ç”¨æˆ·ä¸»åŠ¨é€€å‡ºç™»å½•` | `session.invalidate()` |
| **ğŸ”„ æœåŠ¡å™¨é‡å¯** | `Webåº”ç”¨é‡å¯æˆ–å…³é—­` | `ç»´æŠ¤æˆ–æ›´æ–°` | `è‡ªåŠ¨è§¦å‘` |

```jsp
<%
// ç”¨æˆ·é€€å‡ºç™»å½•çš„å®Œæ•´æµç¨‹
if ("logout".equals(request.getParameter("action"))) {
    // 1. æ¸…é™¤æ•æ„Ÿæ•°æ®ï¼ˆå¯é€‰ï¼‰
    session.removeAttribute("username");
    session.removeAttribute("role");
    
    // 2. é”€æ¯æ•´ä¸ªSession
    session.invalidate();
    
    // 3. é‡å®šå‘åˆ°ç™»å½•é¡µé¢
    response.sendRedirect("login.jsp?message=logout_success");
    return; // é‡è¦ï¼šé˜²æ­¢åç»­ä»£ç æ‰§è¡Œ
}
%>
```

---

## 4. ğŸª Cookieæœºåˆ¶åŸç†


### 4.1 CookieåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ Cookieæ˜¯ä»€ä¹ˆ**

> **Cookie**å°±åƒä½ å»å’–å•¡åº—åŠçš„ä¼šå‘˜å¡ï¼Œä¸Šé¢è®°å½•ç€ä½ çš„åå¥½ä¿¡æ¯ã€‚æ¯æ¬¡ä½ å»å’–å•¡åº—ï¼Œåº—å‘˜çœ‹åˆ°ä¼šå‘˜å¡å°±çŸ¥é“ä½ å–œæ¬¢ä»€ä¹ˆå£å‘³ã€‚

**ğŸ’¡ Cookieå·¥ä½œæµç¨‹**
```
Cookieäº¤äº’è¿‡ç¨‹ï¼š

1. é¦–æ¬¡è®¿é—®
å®¢æˆ·ç«¯                           æœåŠ¡å™¨
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€â”€ HTTPè¯·æ±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                               â”‚ å¤„ç†è¯·æ±‚
  â”‚â†â”€â”€â”€â”€ HTTPå“åº” + Set-Cookie â”€â”€â”€â”‚ åˆ›å»ºCookie
  â”‚     Set-Cookie: sessionId=ABC123

2. åç»­è®¿é—®
  â”‚â”€â”€â”€â”€â”€ HTTPè¯·æ±‚ + Cookie â”€â”€â”€â”€â”€â†’â”‚
  â”‚     Cookie: sessionId=ABC123  â”‚ è¯†åˆ«ç”¨æˆ·
  â”‚â†â”€â”€â”€â”€ HTTPå“åº” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 4.2 åœ¨JSPä¸­æ“ä½œCookie


**ğŸ”¸ åˆ›å»ºå’Œå‘é€Cookie**

```jsp
<%
// âœ… åˆ›å»ºCookieå¯¹è±¡
Cookie userCookie = new Cookie("username", "å¼ ä¸‰");
Cookie themeCookie = new Cookie("theme", "dark");

// ğŸ”§ è®¾ç½®Cookieå±æ€§
userCookie.setMaxAge(7 * 24 * 60 * 60);    // 7å¤©åè¿‡æœŸ
userCookie.setPath("/");                     // åœ¨æ•´ä¸ªç½‘ç«™æœ‰æ•ˆ
userCookie.setHttpOnly(true);               // ä»…HTTPè®¿é—®ï¼Œå¢å¼ºå®‰å…¨æ€§

// ğŸ“¤ å‘é€Cookieåˆ°å®¢æˆ·ç«¯
response.addCookie(userCookie);
response.addCookie(themeCookie);

out.println("Cookieå·²è®¾ç½®æˆåŠŸï¼");
%>
```

**ğŸ”¸ è¯»å–Cookieä¿¡æ¯**

```jsp
<%
// ğŸ“¥ è·å–æ‰€æœ‰Cookie
Cookie[] cookies = request.getCookies();

if (cookies != null) {
    out.println("<h3>æ‰¾åˆ°çš„Cookieä¿¡æ¯ï¼š</h3>");
    for (Cookie cookie : cookies) {
        String name = cookie.getName();
        String value = cookie.getValue();
        out.println(name + " = " + value + "<br>");
    }
} else {
    out.println("æ²¡æœ‰æ‰¾åˆ°Cookieä¿¡æ¯");
}

// ğŸ” æŸ¥æ‰¾ç‰¹å®šCookieçš„ä¾¿æ·æ–¹æ³•
String findCookieValue(Cookie[] cookies, String cookieName) {
    if (cookies != null) {
        for (Cookie cookie : cookies) {
            if (cookieName.equals(cookie.getName())) {
                return cookie.getValue();
            }
        }
    }
    return null;
}

// ä½¿ç”¨ç¤ºä¾‹
String savedUsername = findCookieValue(request.getCookies(), "username");
if (savedUsername != null) {
    out.println("æ¬¢è¿å›æ¥ï¼Œ" + savedUsername);
}
%>
```

### 4.3 Cookieçš„é™åˆ¶å’Œæ³¨æ„äº‹é¡¹


**âš ï¸ Cookieä½¿ç”¨é™åˆ¶**

```
Cookieé™åˆ¶æ¸…å•ï¼š

ğŸ“ å¤§å°é™åˆ¶ï¼šå•ä¸ªCookieæœ€å¤§4KB
ğŸ”¢ æ•°é‡é™åˆ¶ï¼šæ¯ä¸ªåŸŸåæœ€å¤šçº¦300ä¸ªCookie
ğŸŒ åŸŸåé™åˆ¶ï¼šåªèƒ½åœ¨è®¾ç½®çš„åŸŸåä¸‹ä½¿ç”¨
ğŸ›¡ï¸ å®‰å…¨é™åˆ¶ï¼šHTTPä¼ è¾“ï¼Œå®¹æ˜“è¢«çªƒå–
ğŸ“± å®¢æˆ·ç«¯é™åˆ¶ï¼šç”¨æˆ·å¯ä»¥ç¦ç”¨Cookie
```

> **ğŸš¨ å®‰å…¨æç¤º**  
> ç»å¯¹ä¸è¦åœ¨Cookieä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç ã€èº«ä»½è¯å·ç­‰ã€‚Cookieåœ¨ç½‘ç»œä¼ è¾“ä¸­æ˜¯æ˜æ–‡çš„ï¼Œå®¹æ˜“è¢«æ¶æ„æˆªè·ã€‚

---

## 5. ğŸ”— URLé‡å†™æŠ€æœ¯


### 5.1 URLé‡å†™çš„æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ—¶å€™éœ€è¦URLé‡å†™**

å½“ç”¨æˆ·ç¦ç”¨äº†Cookieæ—¶ï¼ŒSession IDæ— æ³•é€šè¿‡Cookieä¼ é€’ï¼Œè¿™æ—¶å°±éœ€è¦**URLé‡å†™**ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆã€‚

```
æ­£å¸¸æƒ…å†µï¼ˆCookieå¯ç”¨ï¼‰ï¼š
https://example.com/user/profile.jsp

URLé‡å†™æƒ…å†µï¼ˆCookieä¸å¯ç”¨ï¼‰ï¼š
https://example.com/user/profile.jsp;jsessionid=ABC123DEF456
```

### 5.2 JSPä¸­çš„URLé‡å†™å®ç°


**ğŸ”¸ è‡ªåŠ¨URLé‡å†™**

```jsp
<%
// âœ… JSPæä¾›è‡ªåŠ¨URLé‡å†™æ–¹æ³•
String loginUrl = response.encodeURL("login.jsp");
String redirectUrl = response.encodeRedirectURL("welcome.jsp");
%>

<h3>å¯¼èˆªé“¾æ¥</h3>
<a href="<%= response.encodeURL("profile.jsp") %>">ä¸ªäººèµ„æ–™</a> |
<a href="<%= response.encodeURL("orders.jsp") %>">æˆ‘çš„è®¢å•</a> |
<a href="<%= response.encodeURL("logout.jsp") %>">é€€å‡ºç™»å½•</a>

<%
// ğŸ”„ é‡å®šå‘æ—¶ä¹Ÿè¦è¿›è¡ŒURLé‡å†™
if ("success".equals(request.getParameter("status"))) {
    response.sendRedirect(response.encodeRedirectURL("dashboard.jsp"));
}
%>
```

**ğŸ”¸ URLé‡å†™çš„å·¥ä½œåŸç†**

```jsp
<%
// ğŸ” æ£€æŸ¥å½“å‰Sessionä¼ é€’æ–¹å¼
HttpSession currentSession = request.getSession();
String sessionInfo = "";

if (request.isRequestedSessionIdFromCookie()) {
    sessionInfo = "Sessioné€šè¿‡Cookieä¼ é€’";
} else if (request.isRequestedSessionIdFromURL()) {
    sessionInfo = "Sessioné€šè¿‡URLé‡å†™ä¼ é€’";
} else {
    sessionInfo = "æœªæ£€æµ‹åˆ°Sessionä¼ é€’æ–¹å¼";
}

out.println("<div style='background:#f0f0f0; padding:10px; margin:10px;'>");
out.println("<strong>å½“å‰Sessionä¿¡æ¯ï¼š</strong><br>");
out.println("Session ID: " + currentSession.getId() + "<br>");
out.println("ä¼ é€’æ–¹å¼: " + sessionInfo + "<br>");
out.println("</div>");
%>
```

### 5.3 URLé‡å†™çš„ä¼˜ç¼ºç‚¹


**ğŸ“Š URLé‡å†™ç‰¹ç‚¹åˆ†æ**

```
âœ… ä¼˜ç‚¹ï¼š
â€¢ ä¸ä¾èµ–Cookieï¼Œå…¼å®¹æ€§å¥½
â€¢ ç”¨æˆ·æ— æ³•ç¦ç”¨
â€¢ å®ç°ç›¸å¯¹ç®€å•

âŒ ç¼ºç‚¹ï¼š
â€¢ URLå˜å¾—å†—é•¿éš¾çœ‹
â€¢ Session IDæš´éœ²åœ¨URLä¸­ï¼Œå®‰å…¨æ€§ä½
â€¢ éœ€è¦å¯¹æ‰€æœ‰é“¾æ¥è¿›è¡Œé‡å†™
â€¢ ç”¨æˆ·å¯èƒ½å¤åˆ¶å¸¦Session IDçš„URLåˆ†äº«
```

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**

```jsp
<%
// ğŸ¯ æ™ºèƒ½é€‰æ‹©Sessionä¼ é€’æ–¹å¼
public String smartEncodeURL(HttpServletResponse response, String url) {
    // ä¼˜å…ˆä½¿ç”¨Cookieï¼ŒCookieä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°URLé‡å†™
    return response.encodeURL(url);
}
%>
```

---

## 6. â±ï¸ ä¼šè¯è¶…æ—¶è®¾ç½®


### 6.1 ä¼šè¯è¶…æ—¶çš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆè¦è®¾ç½®è¶…æ—¶**

```
ä¼šè¯è¶…æ—¶çš„å¿…è¦æ€§ï¼š

ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘ï¼š
â€¢ é˜²æ­¢ç”¨æˆ·å¿˜è®°é€€å‡ºåè¢«ä»–äººä½¿ç”¨
â€¢ å‡å°‘é•¿æ—¶é—´æš´éœ²çš„å®‰å…¨é£é™©

ğŸ’¾ èµ„æºç®¡ç†ï¼š
â€¢ é‡Šæ”¾æœåŠ¡å™¨å†…å­˜èµ„æº
â€¢ é¿å…æ— ç”¨Sessionå ç”¨ç©ºé—´

ğŸ“± ç”¨æˆ·ä½“éªŒï¼š
â€¢ æé†’ç”¨æˆ·ä¼šè¯å³å°†è¿‡æœŸ
â€¢ é¿å…é‡è¦æ“ä½œæ—¶çªç„¶è¿‡æœŸ
```

### 6.2 è®¾ç½®Sessionè¶…æ—¶çš„æ–¹æ³•


**ğŸ”¸ æ–¹æ³•1ï¼šåœ¨JSPä¸­åŠ¨æ€è®¾ç½®**

```jsp
<%
// â° è®¾ç½®Sessionè¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
session.setMaxInactiveInterval(30 * 60);  // 30åˆ†é’Ÿ

// ğŸ“Š å¸¸è§çš„è¶…æ—¶æ—¶é—´è®¾ç½®
if ("admin".equals(userRole)) {
    session.setMaxInactiveInterval(60 * 60);     // ç®¡ç†å‘˜ï¼š1å°æ—¶
} else if ("vip".equals(userRole)) {
    session.setMaxInactiveInterval(45 * 60);     // VIPç”¨æˆ·ï¼š45åˆ†é’Ÿ
} else {
    session.setMaxInactiveInterval(20 * 60);     // æ™®é€šç”¨æˆ·ï¼š20åˆ†é’Ÿ
}

// ğŸ” è·å–å½“å‰è¶…æ—¶è®¾ç½®
int timeoutSeconds = session.getMaxInactiveInterval();
int timeoutMinutes = timeoutSeconds / 60;
out.println("å½“å‰ä¼šè¯è¶…æ—¶æ—¶é—´ï¼š" + timeoutMinutes + "åˆ†é’Ÿ");
%>
```

**ğŸ”¸ æ–¹æ³•2ï¼šåœ¨web.xmlä¸­å…¨å±€è®¾ç½®**

```xml
<!-- web.xmlé…ç½®æ–‡ä»¶ -->
<web-app>
    <!-- ğŸŒ å…¨å±€Sessionè¶…æ—¶è®¾ç½®ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰ -->
    <session-config>
        <session-timeout>30</session-timeout>
    </session-config>
</web-app>
```

### 6.3 ä¼šè¯è¶…æ—¶ç›‘æ§å’Œæé†’


**ğŸ”¸ è®¡ç®—å‰©ä½™æ—¶é—´**

```jsp
<%
// â³ è®¡ç®—Sessionå‰©ä½™æ—¶é—´
public String getSessionRemainingTime(HttpSession session) {
    long lastAccess = session.getLastAccessedTime();
    int maxInactive = session.getMaxInactiveInterval();
    long currentTime = System.currentTimeMillis();
    
    long elapsedTime = (currentTime - lastAccess) / 1000; // å·²ç»è¿‡æ—¶é—´(ç§’)
    long remainingTime = maxInactive - elapsedTime;       // å‰©ä½™æ—¶é—´(ç§’)
    
    if (remainingTime <= 0) {
        return "ä¼šè¯å·²è¿‡æœŸ";
    } else {
        long minutes = remainingTime / 60;
        long seconds = remainingTime % 60;
        return minutes + "åˆ†" + seconds + "ç§’";
    }
}

// ğŸ“Š æ˜¾ç¤ºä¼šè¯çŠ¶æ€
String remainingTime = getSessionRemainingTime(session);
%>

<div style="background:#fff3cd; border:1px solid #ffeaa7; padding:10px; margin:10px;">
    <strong>â±ï¸ ä¼šè¯çŠ¶æ€ï¼š</strong><br>
    å‰©ä½™æ—¶é—´ï¼š<%= remainingTime %><br>
    <small>ğŸ’¡ æç¤ºï¼šç»§ç»­æ“ä½œå¯è‡ªåŠ¨å»¶é•¿ä¼šè¯æ—¶é—´</small>
</div>
```

**ğŸ”¸ è‡ªåŠ¨åˆ·æ–°ä¼šè¯**

```jsp
<%
// ğŸ”„ ä¿æŒä¼šè¯æ´»è·ƒçš„AJAXç¤ºä¾‹
%>
<script>
// JavaScriptä»£ç ï¼šæ¯5åˆ†é’Ÿè‡ªåŠ¨å‘é€è¯·æ±‚ä¿æŒä¼šè¯æ´»è·ƒ
setInterval(function() {
    fetch('keep-session.jsp', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'action=keep-alive'
    });
}, 5 * 60 * 1000); // 5åˆ†é’Ÿ
</script>
```

---

## 7. ğŸš€ å®æˆ˜åº”ç”¨æ¡ˆä¾‹


### 7.1 å®Œæ•´çš„ç”¨æˆ·ç™»å½•ç³»ç»Ÿ


**ğŸ”¸ ç™»å½•é¡µé¢ (login.jsp)**

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<!DOCTYPE html>
<html>
<head>
    <title>ç”¨æˆ·ç™»å½•</title>
    <style>
        .login-form { width: 300px; margin: 50px auto; padding: 20px; 
                     border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin-bottom: 15px; }
        .form-control { width: 100%; padding: 8px; }
        .btn { padding: 10px 20px; background: #007bff; color: white; 
               border: none; border-radius: 3px; cursor: pointer; }
        .error { color: #dc3545; margin-top: 10px; }
        .success { color: #28a745; margin-top: 10px; }
    </style>
</head>
<body>
    <%
    // ğŸ” æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
    HttpSession userSession = request.getSession(false);
    if (userSession != null && userSession.getAttribute("username") != null) {
        response.sendRedirect("welcome.jsp");
        return;
    }
    
    // ğŸ“ å¤„ç†ç™»å½•è¡¨å•æäº¤
    String message = "";
    String messageType = "";
    
    if ("POST".equals(request.getMethod())) {
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        String remember = request.getParameter("remember");
        
        // ğŸ” ç®€å•çš„ç”¨æˆ·éªŒè¯ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥æŸ¥è¯¢æ•°æ®åº“ï¼‰
        if ("admin".equals(username) && "123456".equals(password)) {
            // âœ… ç™»å½•æˆåŠŸ
            HttpSession newSession = request.getSession(true);
            newSession.setAttribute("username", username);
            newSession.setAttribute("loginTime", new java.util.Date());
            newSession.setAttribute("role", "admin");
            
            // ğŸ• æ ¹æ®"è®°ä½æˆ‘"è®¾ç½®ä¸åŒçš„è¶…æ—¶æ—¶é—´
            if ("on".equals(remember)) {
                newSession.setMaxInactiveInterval(7 * 24 * 60 * 60); // 7å¤©
                
                // ğŸª è®¾ç½®é•¿æœŸCookie
                Cookie userCookie = new Cookie("savedUsername", username);
                userCookie.setMaxAge(30 * 24 * 60 * 60); // 30å¤©
                userCookie.setPath("/");
                response.addCookie(userCookie);
            } else {
                newSession.setMaxInactiveInterval(30 * 60); // 30åˆ†é’Ÿ
            }
            
            response.sendRedirect("welcome.jsp");
            return;
        } else {
            // âŒ ç™»å½•å¤±è´¥
            message = "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼";
            messageType = "error";
        }
    }
    
    // ğŸª æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ç”¨æˆ·å
    String savedUsername = "";
    Cookie[] cookies = request.getCookies();
    if (cookies != null) {
        for (Cookie cookie : cookies) {
            if ("savedUsername".equals(cookie.getName())) {
                savedUsername = cookie.getValue();
                break;
            }
        }
    }
    
    // ğŸ”” æ£€æŸ¥é€€å‡ºæ¶ˆæ¯
    if ("logout_success".equals(request.getParameter("message"))) {
        message = "æ‚¨å·²æˆåŠŸé€€å‡ºç™»å½•";
        messageType = "success";
    }
    %>
    
    <div class="login-form">
        <h2>ğŸ” ç”¨æˆ·ç™»å½•</h2>
        <form method="post">
            <div class="form-group">
                <label for="username">ç”¨æˆ·åï¼š</label>
                <input type="text" id="username" name="username" 
                       class="form-control" value="<%= savedUsername %>" required>
            </div>
            
            <div class="form-group">
                <label for="password">å¯†ç ï¼š</label>
                <input type="password" id="password" name="password" 
                       class="form-control" required>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" name="remember"> è®°ä½æˆ‘ (ä¿æŒ7å¤©ç™»å½•)
                </label>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn">ç™»å½•</button>
            </div>
            
            <% if (!message.isEmpty()) { %>
                <div class="<%= messageType %>"><%= message %></div>
            <% } %>
        </form>
        
        <div style="margin-top: 20px; font-size: 12px; color: #666;">
            ğŸ’¡ æµ‹è¯•è´¦å·ï¼šadmin / 123456
        </div>
    </div>
</body>
</html>
```

**ğŸ”¸ æ¬¢è¿é¡µé¢ (welcome.jsp)**

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ page import="java.util.Date, java.text.SimpleDateFormat" %>
<!DOCTYPE html>
<html>
<head>
    <title>ç”¨æˆ·ä¸­å¿ƒ</title>
    <style>
        .container { max-width: 800px; margin: 20px auto; padding: 20px; }
        .header { background: #f8f9fa; padding: 15px; margin-bottom: 20px; 
                 border-radius: 5px; border-left: 4px solid #007bff; }
        .session-info { background: #e9ecef; padding: 15px; margin: 15px 0; 
                       border-radius: 5px; }
        .btn { padding: 8px 16px; margin: 5px; text-decoration: none; 
               border-radius: 3px; display: inline-block; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-primary { background: #007bff; color: white; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; 
                  padding: 10px; margin: 10px 0; border-radius: 3px; }
    </style>
    <script>
        // â° å®æ—¶æ›´æ–°å‰©ä½™æ—¶é—´
        function updateSessionTime() {
            fetch('session-time.jsp')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('remaining-time').innerHTML = data;
                });
        }
        
        // æ¯30ç§’æ›´æ–°ä¸€æ¬¡
        setInterval(updateSessionTime, 30000);
        
        // ğŸ”„ ä¿æŒä¼šè¯æ´»è·ƒ
        function keepSessionAlive() {
            fetch('keep-session.jsp', { method: 'POST' });
        }
        
        // æ¯5åˆ†é’Ÿå‘é€ä¸€æ¬¡keep-aliveè¯·æ±‚
        setInterval(keepSessionAlive, 5 * 60 * 1000);
    </script>
</head>
<body>
    <%
    // ğŸ›¡ï¸ æ£€æŸ¥ç™»å½•çŠ¶æ€
    HttpSession userSession = request.getSession(false);
    if (userSession == null || userSession.getAttribute("username") == null) {
        response.sendRedirect("login.jsp");
        return;
    }
    
    // ğŸ“Š è·å–ç”¨æˆ·ä¿¡æ¯
    String username = (String) userSession.getAttribute("username");
    String role = (String) userSession.getAttribute("role");
    Date loginTime = (Date) userSession.getAttribute("loginTime");
    
    // ğŸ• æ ¼å¼åŒ–æ—¶é—´
    SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    
    // â³ è®¡ç®—ä¼šè¯ä¿¡æ¯
    long currentTime = System.currentTimeMillis();
    long lastAccessTime = userSession.getLastAccessedTime();
    int maxInactive = userSession.getMaxInactiveInterval();
    long elapsedSeconds = (currentTime - lastAccessTime) / 1000;
    long remainingSeconds = maxInactive - elapsedSeconds;
    %>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ‘‹ æ¬¢è¿ï¼Œ<%= username %>ï¼</h1>
            <p>æ‚¨çš„èº«ä»½ï¼š<strong><%= role %></strong> | 
               ç™»å½•æ—¶é—´ï¼š<%= sdf.format(loginTime) %></p>
        </div>
        
        <div class="session-info">
            <h3>ğŸ“Š ä¼šè¯ä¿¡æ¯</h3>
            <p><strong>Session IDï¼š</strong><%= userSession.getId() %></p>
            <p><strong>åˆ›å»ºæ—¶é—´ï¼š</strong><%= sdf.format(new Date(userSession.getCreationTime())) %></p>
            <p><strong>æœ€åè®¿é—®ï¼š</strong><%= sdf.format(new Date(lastAccessTime)) %></p>
            <p><strong>è¶…æ—¶è®¾ç½®ï¼š</strong><%= maxInactive / 60 %>åˆ†é’Ÿ</p>
            <p><strong>å‰©ä½™æ—¶é—´ï¼š</strong>
               <span id="remaining-time">
                   <% if (remainingSeconds > 0) { %>
                       <%= remainingSeconds / 60 %>åˆ†<%= remainingSeconds % 60 %>ç§’
                   <% } else { %>
                       ä¼šè¯å·²è¿‡æœŸ
                   <% } %>
               </span>
            </p>
        </div>
        
        <% if (remainingSeconds < 300) { // å°‘äº5åˆ†é’Ÿæ—¶æ˜¾ç¤ºè­¦å‘Š %>
        <div class="warning">
            âš ï¸ <strong>æ³¨æ„ï¼š</strong>æ‚¨çš„ä¼šè¯å°†åœ¨5åˆ†é’Ÿå†…è¿‡æœŸï¼Œè¯·åŠæ—¶ä¿å­˜å·¥ä½œå†…å®¹ã€‚
            <button onclick="keepSessionAlive()" class="btn btn-primary">å»¶é•¿ä¼šè¯</button>
        </div>
        <% } %>
        
        <div style="margin: 20px 0;">
            <h3>ğŸ”— å¿«æ·å¯¼èˆª</h3>
            <a href="<%= response.encodeURL("profile.jsp") %>" class="btn btn-primary">ä¸ªäººèµ„æ–™</a>
            <a href="<%= response.encodeURL("settings.jsp") %>" class="btn btn-primary">ç³»ç»Ÿè®¾ç½®</a>
            <a href="logout.jsp" class="btn btn-danger">é€€å‡ºç™»å½•</a>
        </div>
        
        <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
            <h4>ğŸ’¡ ä¼šè¯ç®¡ç†æŠ€æœ¯è¯´æ˜</h4>
            <ul>
                <li><strong>Sessionå­˜å‚¨ï¼š</strong>ç”¨æˆ·ä¿¡æ¯å®‰å…¨å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯</li>
                <li><strong>è‡ªåŠ¨è¶…æ—¶ï¼š</strong>é•¿æ—¶é—´ä¸æ´»åŠ¨è‡ªåŠ¨é€€å‡ºä¿æŠ¤è´¦æˆ·å®‰å…¨</li>
                <li><strong>Cookieæ”¯æŒï¼š</strong>ä¼˜å…ˆä½¿ç”¨Cookieï¼Œä¸æ”¯æŒæ—¶è‡ªåŠ¨åˆ‡æ¢URLé‡å†™</li>
                <li><strong>è®°ä½ç™»å½•ï¼š</strong>å‹¾é€‰"è®°ä½æˆ‘"å¯å»¶é•¿ä¼šè¯æ—¶é—´è‡³7å¤©</li>
            </ul>
        </div>
    </div>
</body>
</html>
```

### 7.2 è´­ç‰©è½¦åŠŸèƒ½å®ç°


**ğŸ”¸ è´­ç‰©è½¦ç®¡ç† (shopping-cart.jsp)**

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ page import="java.util.*, java.math.BigDecimal" %>
<!DOCTYPE html>
<html>
<head>
    <title>è´­ç‰©è½¦ç®¡ç†</title>
    <style>
        .container { max-width: 1000px; margin: 20px auto; padding: 20px; }
        .cart-item { border: 1px solid #ddd; margin: 10px 0; padding: 15px; 
                    border-radius: 5px; display: flex; align-items: center; }
        .item-info { flex: 1; }
        .item-actions { margin-left: 20px; }
        .btn { padding: 5px 10px; margin: 0 2px; border: none; border-radius: 3px; 
               cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-primary { background: #007bff; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-success { background: #28a745; color: white; }
        .total-section { background: #f8f9fa; padding: 20px; margin: 20px 0; 
                        border-radius: 5px; text-align: right; }
        .empty-cart { text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body>
    <%
    // ğŸ›¡ï¸ æ£€æŸ¥ç™»å½•çŠ¶æ€
    HttpSession userSession = request.getSession(false);
    if (userSession == null) {
        response.sendRedirect("login.jsp");
        return;
    }
    
    // ğŸ›’ è´­ç‰©è½¦å•†å“ç±»
    class CartItem {
        private String id;
        private String name;
        private BigDecimal price;
        private int quantity;
        
        public CartItem(String id, String name, BigDecimal price, int quantity) {
            this.id = id;
            this.name = name;
            this.price = price;
            this.quantity = quantity;
        }
        
        // getterå’Œsetteræ–¹æ³•
        public String getId() { return id; }
        public String getName() { return name; }
        public BigDecimal getPrice() { return price; }
        public int getQuantity() { return quantity; }
        public void setQuantity(int quantity) { this.quantity = quantity; }
        
        public BigDecimal getSubtotal() {
            return price.multiply(new BigDecimal(quantity));
        }
    }
    
    // ğŸ“¦ åˆå§‹åŒ–è´­ç‰©è½¦
    Map<String, CartItem> cart = (Map<String, CartItem>) userSession.getAttribute("shoppingCart");
    if (cart == null) {
        cart = new HashMap<String, CartItem>();
        userSession.setAttribute("shoppingCart", cart);
    }
    
    // ğŸ”„ å¤„ç†è´­ç‰©è½¦æ“ä½œ
    String action = request.getParameter("action");
    String itemId = request.getParameter("itemId");
    
    if ("add".equals(action) && itemId != null) {
        // â• æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
        String itemName = request.getParameter("itemName");
        String itemPriceStr = request.getParameter("itemPrice");
        String quantityStr = request.getParameter("quantity");
        
        if (itemName != null && itemPriceStr != null) {
            BigDecimal price = new BigDecimal(itemPriceStr);
            int quantity = quantityStr != null ? Integer.parseInt(quantityStr) : 1;
            
            if (cart.containsKey(itemId)) {
                // å•†å“å·²å­˜åœ¨ï¼Œå¢åŠ æ•°é‡
                CartItem existingItem = cart.get(itemId);
                existingItem.setQuantity(existingItem.getQuantity() + quantity);
            } else {
                // æ–°å•†å“ï¼Œæ·»åŠ åˆ°è´­ç‰©è½¦
                cart.put(itemId, new CartItem(itemId, itemName, price, quantity));
            }
        }
    } else if ("remove".equals(action) && itemId != null) {
        // âŒ ä»è´­ç‰©è½¦ç§»é™¤å•†å“
        cart.remove(itemId);
    } else if ("update".equals(action) && itemId != null) {
        // ğŸ”„ æ›´æ–°å•†å“æ•°é‡
        String quantityStr = request.getParameter("quantity");
        if (quantityStr != null && cart.containsKey(itemId)) {
            int newQuantity = Integer.parseInt(quantityStr);
            if (newQuantity > 0) {
                cart.get(itemId).setQuantity(newQuantity);
            } else {
                cart.remove(itemId); // æ•°é‡ä¸º0æ—¶ç§»é™¤å•†å“
            }
        }
    } else if ("clear".equals(action)) {
        // ğŸ—‘ï¸ æ¸…ç©ºè´­ç‰©è½¦
        cart.clear();
    }
    
    // ğŸ’° è®¡ç®—è´­ç‰©è½¦æ€»è®¡
    BigDecimal totalAmount = BigDecimal.ZERO;
    int totalItems = 0;
    
    for (CartItem item : cart.values()) {
        totalAmount = totalAmount.add(item.getSubtotal());
        totalItems += item.getQuantity();
    }
    %>
    
    <div class="container">
        <h1>ğŸ›’ è´­ç‰©è½¦ç®¡ç†</h1>
        
        <div style="margin: 20px 0;">
            <a href="products.jsp" class="btn btn-primary">ç»§ç»­è´­ç‰©</a>
            <span style="margin-left: 20px;">
                å½“å‰å•†å“ï¼š<strong><%= totalItems %></strong> ä»¶ | 
                æ€»é‡‘é¢ï¼š<strong>Â¥<%= totalAmount %></strong>
            </span>
        </div>
        
        <% if (cart.isEmpty()) { %>
            <div class="empty-cart">
                <h3>ğŸ›’ è´­ç‰©è½¦æ˜¯ç©ºçš„</h3>
                <p>å¿«å»é€‰è´­æ‚¨å–œæ¬¢çš„å•†å“å§ï¼</p>
                <a href="products.jsp" class="btn btn-primary">å¼€å§‹è´­ç‰©</a>
            </div>
        <% } else { %>
            <div id="cart-items">
                <% for (CartItem item : cart.values()) { %>
                <div class="cart-item">
                    <div class="item-info">
                        <h4><%= item.getName() %></h4>
                        <p>å•ä»·ï¼šÂ¥<%= item.getPrice() %> | 
                           æ•°é‡ï¼š<%= item.getQuantity() %> | 
                           å°è®¡ï¼šÂ¥<%= item.getSubtotal() %></p>
                    </div>
                    <div class="item-actions">
                        <form style="display: inline-block;" method="post">
                            <input type="hidden" name="action" value="update">
                            <input type="hidden" name="itemId" value="<%= item.getId() %>">
                            <input type="number" name="quantity" value="<%= item.getQuantity() %>" 
                                   min="0" style="width: 60px;" onchange="this.form.submit()">
                        </form>
                        <a href="?action=remove&itemId=<%= item.getId() %>" 
                           class="btn btn-danger" 
                           onclick="return confirm('ç¡®å®šè¦ç§»é™¤è¿™ä¸ªå•†å“å—ï¼Ÿ')">ç§»é™¤</a>
                    </div>
                </div>
                <% } %>
            </div>
            
            <div class="total-section">
                <h3>ğŸ“Š è®¢å•æ±‡æ€»</h3>
                <p>å•†å“æ€»æ•°ï¼š<%= totalItems %> ä»¶</p>
                <p>å•†å“æ€»é¢ï¼šÂ¥<%= totalAmount %></p>
                <hr>
                <h4>åº”ä»˜é‡‘é¢ï¼šÂ¥<%= totalAmount %></h4>
                <div style="margin-top: 20px;">
                    <a href="checkout.jsp" class="btn btn-success">å»ç»“ç®—</a>
                    <a href="?action=clear" class="btn btn-danger" 
                       onclick="return confirm('ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿ')">æ¸…ç©ºè´­ç‰©è½¦</a>
                </div>
            </div>
        <% } %>
        
        <!-- ğŸ“Š ä¼šè¯ä¸­çš„è´­ç‰©è½¦ä¿¡æ¯å±•ç¤º -->
        <div style="margin-top: 30px; padding: 15px; background: #e9ecef; border-radius: 5px;">
            <h4>ğŸ” Sessionå­˜å‚¨ä¿¡æ¯</h4>
            <p><strong>Session IDï¼š</strong><%= userSession.getId() %></p>
            <p><strong>è´­ç‰©è½¦å•†å“æ•°ï¼š</strong><%= cart.size() %> ç§</p>
            <p><strong>å­˜å‚¨é”®åï¼š</strong>shoppingCart</p>
            <small>ğŸ’¡ è´­ç‰©è½¦æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯Sessionä¸­ï¼Œå®‰å…¨å¯é ï¼Œæµè§ˆå™¨å…³é—­åä¸‹æ¬¡è®¿é—®ä»ç„¶ä¿ç•™</small>
        </div>
    </div>
</body>
</html>
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¼šè¯ç®¡ç†æœ¬è´¨ï¼šåœ¨æ— çŠ¶æ€HTTPä¸Šæ„å»ºæœ‰çŠ¶æ€äº¤äº’
ğŸ”¸ HttpSessionå¯¹è±¡ï¼šæœåŠ¡å™¨ç«¯å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„å®¹å™¨
ğŸ”¸ Cookieæœºåˆ¶ï¼šå®¢æˆ·ç«¯å­˜å‚¨ï¼Œè‡ªåŠ¨ä¼ è¾“SessionID
ğŸ”¸ URLé‡å†™ï¼šCookieä¸å¯ç”¨æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
ğŸ”¸ ä¼šè¯è¶…æ—¶ï¼šè‡ªåŠ¨æ¸…ç†æ— æ•ˆä¼šè¯ï¼Œä¿æŠ¤ç³»ç»Ÿèµ„æº
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¼šè¯ç®¡ç†çš„å·¥ä½œæµç¨‹**
```
ç”¨æˆ·è®¿é—® â†’ åˆ›å»ºSession â†’ åˆ†é…SessionID â†’ é€šè¿‡Cookie/URLä¼ é€’
â†’ åç»­è¯·æ±‚æºå¸¦SessionID â†’ æœåŠ¡å™¨è¯†åˆ«ç”¨æˆ· â†’ ç»´æŠ¤ä¼šè¯çŠ¶æ€
```

**ğŸ”¹ æŠ€æœ¯é€‰æ‹©çš„åŸåˆ™**
```
æ•æ„Ÿæ•°æ®ï¼šSessionå­˜å‚¨ï¼ˆæœåŠ¡å™¨ç«¯ï¼Œå®‰å…¨ï¼‰
ç®€å•æ•°æ®ï¼šCookieå­˜å‚¨ï¼ˆå®¢æˆ·ç«¯ï¼Œæ–¹ä¾¿ï¼‰
å…¼å®¹æ€§è¦æ±‚é«˜ï¼šURLé‡å†™ï¼ˆæ‰€æœ‰æµè§ˆå™¨æ”¯æŒï¼‰
ç”¨æˆ·ä½“éªŒä¼˜å…ˆï¼šCookie + URLé‡å†™è‡ªåŠ¨åˆ‡æ¢
```

**ğŸ”¹ å®‰å…¨æ€§è€ƒè™‘**
```
â€¢ æ•æ„Ÿä¿¡æ¯ç»ä¸æ”¾åœ¨Cookieä¸­
â€¢ è®¾ç½®åˆç†çš„Sessionè¶…æ—¶æ—¶é—´
â€¢ ç”¨æˆ·é€€å‡ºæ—¶ä¸»åŠ¨é”€æ¯Session
â€¢ ä½¿ç”¨HTTPSé˜²æ­¢SessionIDè¢«æˆªè·
```

### 8.3 å®é™…å¼€å‘åº”ç”¨ä»·å€¼


- **ğŸ” ç”¨æˆ·è®¤è¯**ï¼šç™»å½•çŠ¶æ€ç»´æŠ¤ï¼Œæƒé™æ§åˆ¶
- **ğŸ›’ ç”µå•†åº”ç”¨**ï¼šè´­ç‰©è½¦ã€è®¢å•æµç¨‹ç®¡ç†
- **ğŸ“Š ä¸ªæ€§åŒ–**ï¼šç”¨æˆ·åå¥½è®¾ç½®ã€å†å²è®°å½•
- **ğŸ¯ ä¸šåŠ¡æµç¨‹**ï¼šå¤šæ­¥éª¤æ“ä½œçš„çŠ¶æ€ä¿æŒ
- **ğŸ“± ç§»åŠ¨é€‚é…**ï¼šè·¨é¡µé¢æ•°æ®ä¼ é€’å’ŒçŠ¶æ€ç®¡ç†

### 8.4 å­¦ä¹ è¿›é˜¶å»ºè®®


**ğŸš€ æ·±å…¥å­¦ä¹ æ–¹å‘**
1. **ğŸ”’ Sessionå®‰å…¨**ï¼šé˜²åŠ«æŒã€é˜²å›ºå®šæ”»å‡»
2. **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼šSessioné›†ç¾¤ã€åˆ†å¸ƒå¼å­˜å‚¨
3. **ğŸŒ ç°ä»£æ›¿ä»£**ï¼šJWT Tokenã€OAuthè®¤è¯
4. **ğŸ“± ç§»åŠ¨ç«¯**ï¼šRESTful APIä¸­çš„çŠ¶æ€ç®¡ç†

**ğŸ’¡ å®è·µé¡¹ç›®å»ºè®®**
- å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ˆæ³¨å†Œã€ç™»å½•ã€æƒé™ï¼‰
- åœ¨çº¿è´­ç‰©å¹³å°ï¼ˆè´­ç‰©è½¦ã€è®¢å•ã€æ”¯ä»˜æµç¨‹ï¼‰
- å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆæ–‡ç« ç¼–è¾‘ã€å¤šæ­¥éª¤å‘å¸ƒï¼‰
- åœ¨çº¿è€ƒè¯•ç³»ç»Ÿï¼ˆç­”é¢˜è¿›åº¦ã€æ—¶é—´æ§åˆ¶ï¼‰

**æ ¸å¿ƒè®°å¿†**ï¼š
- **Sessionæ˜¯æœåŠ¡å™¨çš„è®°å¿†ï¼ŒCookieæ˜¯æµè§ˆå™¨çš„ä¾¿ç­¾**
- **å®‰å…¨ç¬¬ä¸€ï¼šæ•æ„Ÿæ•°æ®Sessionå­˜ï¼Œç®€å•æ•°æ®Cookieæ”¾**
- **ç”¨æˆ·ä½“éªŒï¼šåˆç†è¶…æ—¶+å‹å¥½æé†’+è‡ªåŠ¨ä¿æ´»**
- **æŠ€æœ¯é€‰æ‹©ï¼šCookieä¼˜å…ˆï¼ŒURLé‡å†™å…œåº•ï¼Œçµæ´»ç»„åˆ**