---
title: 1、JSP中的Java代码
---
## 📚 目录

1. [JSP中的Java代码基础](#1-jsp中的java代码基础)
2. [脚本片段编写Java逻辑](#2-脚本片段编写java逻辑)
3. [变量声明和方法定义](#3-变量声明和方法定义)
4. [为什么要避免复杂业务逻辑](#4-为什么要避免复杂业务逻辑)
5. [JSP与Servlet分工原则](#5-jsp与servlet分工原则)
6. [核心要点总结](#6-核心要点总结)

---

## 1. 🔧 JSP中的Java代码基础


### 1.1 什么是JSP中的Java代码


JSP（Java Server Pages）最强大的地方就是能够**在HTML页面中直接写Java代码**。想象一下，你正在制作一个网页，需要显示当前时间，传统HTML做不到，但JSP可以！

💡 **通俗理解**：
- **普通HTML**：就像一张静态的图片，内容固定不变
- **JSP**：就像一台智能电视，可以根据不同情况显示不同内容

### 1.2 JSP中Java代码的三种形式


| 代码类型 | **语法格式** | **作用说明** | **使用场景** |
|---------|------------|-------------|-------------|
| 🔸 **脚本片段** | `<% Java代码 %>` | `在页面中执行Java逻辑` | `循环、判断、业务处理` |
| 🔸 **表达式** | `<%= Java表达式 %>` | `输出Java变量或方法结果` | `显示数据、计算结果` |
| 🔸 **声明** | `<%! Java声明 %>` | `声明变量和方法` | `定义工具方法、全局变量` |

### 1.3 简单示例对比


**传统HTML写法**：
```html
<h1>欢迎访问我们的网站</h1>
<p>今天是2025年1月14日</p>
```

**JSP写法**：
```jsp
<h1>欢迎访问我们的网站</h1>
<p>今天是<%= new java.util.Date() %></p>
```

🎯 **区别在哪里**：
- HTML版本：日期是固定的，永远显示"2025年1月14日"
- JSP版本：每次访问都显示**真实的当前日期**

---

## 2. 📝 脚本片段编写Java逻辑


### 2.1 脚本片段的基本概念


🔸 **什么是脚本片段**：
脚本片段就是用`<% %>`包围的Java代码块，可以在里面写任何Java语句，比如变量定义、条件判断、循环等。

💡 **生活类比**：
想象你在写一封信，突然需要插入一段计算内容：
- **普通信件**：只能写死固定的数字
- **JSP信件**：可以插入一段计算逻辑，自动算出结果

### 2.2 脚本片段的基本用法


```jsp
<%
    // 这里可以写任何Java代码
    String userName = "张三";
    int age = 25;
    boolean isStudent = true;
%>

<h2>用户信息</h2>
<p>姓名：<%= userName %></p>
<p>年龄：<%= age %></p>
<p>是否学生：<%= isStudent ? "是" : "否" %></p>
```

### 2.3 条件判断示例


**场景**：根据时间显示不同的问候语

```jsp
<%
    java.util.Calendar cal = java.util.Calendar.getInstance();
    int hour = cal.get(java.util.Calendar.HOUR_OF_DAY);
    String greeting = "";
    
    if (hour < 12) {
        greeting = "上午好";
    } else if (hour < 18) {
        greeting = "下午好";
    } else {
        greeting = "晚上好";
    }
%>

<h1><%= greeting %>，欢迎访问！</h1>
<p>现在是<%= hour %>点</p>
```

### 2.4 循环处理示例


**场景**：动态生成表格数据

```jsp
<table border="1">
    <tr>
        <th>序号</th>
        <th>商品名称</th>
        <th>价格</th>
    </tr>
    <%
        String[] products = {"苹果", "香蕉", "橘子"};
        double[] prices = {5.0, 3.0, 4.0};
        
        for (int i = 0; i < products.length; i++) {
    %>
    <tr>
        <td><%= i + 1 %></td>
        <td><%= products[i] %></td>
        <td>￥<%= prices[i] %></td>
    </tr>
    <%
        }
    %>
</table>
```

⚡ **运行结果**：
```
序号  商品名称  价格
1     苹果     ￥5.0
2     香蕉     ￥3.0
3     橘子     ￥4.0
```

---

## 3. 🛠️ 变量声明和方法定义


### 3.1 局部变量 vs 成员变量


**局部变量（脚本片段中）**：
```jsp
<%
    String message = "这是局部变量";  // 每次请求都会重新创建
    int count = 1;
%>
```

**成员变量（声明块中）**：
```jsp
<%!
    private String siteName = "我的网站";    // 所有用户共享
    private int visitCount = 0;             // 访问计数器
%>
```

💡 **通俗解释区别**：
- **局部变量**：就像你每次进餐厅都重新点菜，每次访问页面都重新创建
- **成员变量**：就像餐厅的招牌，所有客人都能看到，所有访问者共享

### 3.2 方法定义示例


**定义工具方法**：
```jsp
<%!
    // 计算两个数的最大值
    public int getMax(int a, int b) {
        return a > b ? a : b;
    }
    
    // 格式化日期显示
    public String formatDate(java.util.Date date) {
        java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        return sdf.format(date);
    }
    
    // 检查是否为工作日
    public boolean isWorkday() {
        java.util.Calendar cal = java.util.Calendar.getInstance();
        int dayOfWeek = cal.get(java.util.Calendar.DAY_OF_WEEK);
        return dayOfWeek >= 2 && dayOfWeek <= 6;  // 周一到周五
    }
%>

<h2>工具方法演示</h2>
<p>10和20的最大值：<%= getMax(10, 20) %></p>
<p>当前时间：<%= formatDate(new java.util.Date()) %></p>
<p>今天是工作日吗：<%= isWorkday() ? "是" : "否" %></p>
```

### 3.3 变量作用域理解


```
页面结构：
┌─────────────────────────────────┐
│ <%! 成员变量和方法 %>            │ ← 整个类级别，所有用户共享
├─────────────────────────────────┤
│ <% 局部变量 %>                  │ ← 方法级别，每次请求独立
│ HTML内容                        │
│ <%= 表达式 %>                   │ ← 可以访问上面的变量
│ <% 更多局部代码 %>              │
└─────────────────────────────────┘
```

⚠️ **重要提醒**：
- `成员变量`：多个用户访问时会互相影响
- `局部变量`：每次访问都是全新的，更安全

---

## 4. ⚠️ 为什么要避免复杂业务逻辑


### 4.1 JSP中写复杂逻辑的问题


**❌ 问题示例（不推荐）**：
```jsp
<%
    // 复杂的用户验证逻辑（不应该放在JSP中）
    String username = request.getParameter("username");
    String password = request.getParameter("password");
    
    Connection conn = null;
    PreparedStatement ps = null;
    ResultSet rs = null;
    boolean loginSuccess = false;
    
    try {
        // 数据库连接代码
        Class.forName("com.mysql.jdbc.Driver");
        conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/mydb", "root", "password");
        ps = conn.prepareStatement("SELECT * FROM users WHERE username=? AND password=?");
        ps.setString(1, username);
        ps.setString(2, password);
        rs = ps.executeQuery();
        
        if (rs.next()) {
            loginSuccess = true;
            session.setAttribute("user", rs.getString("username"));
        }
    } catch (Exception e) {
        e.printStackTrace();
    } finally {
        // 关闭资源的代码...
    }
%>

<% if (loginSuccess) { %>
    <h2>登录成功！</h2>
<% } else { %>
    <h2>登录失败！</h2>
<% } %>
```

### 4.2 这样写的严重问题


| 问题类型 | **具体问题** | **后果影响** |
|---------|------------|-------------|
| 🔴 **混乱难读** | `HTML和Java代码混在一起` | `维护困难，容易出错` |
| 🔴 **职责不清** | `页面既要显示又要处理业务` | `代码结构混乱` |
| 🔴 **难以测试** | `业务逻辑嵌在页面中` | `无法单独测试逻辑` |
| 🔴 **重用性差** | `逻辑写死在特定页面` | `其他页面无法重用` |
| 🔴 **团队协作** | `前端和后端开发者都要改同一个文件` | `容易产生冲突` |

### 4.3 正确的做法


💡 **职责分离原则**：

```
用户请求流程：
浏览器 → Servlet(处理业务逻辑) → JSP(展示数据)

┌─────────────┐    ┌──────────────┐    ┌─────────────┐
│   浏览器     │───→│   Servlet    │───→│    JSP      │
│ 发送请求     │    │ 处理业务逻辑  │    │ 展示页面    │
│             │←───│ 准备数据     │    │ 显示数据    │
└─────────────┘    └──────────────┘    └─────────────┘
```

**✅ 推荐做法**：

**1. Servlet处理业务逻辑**：
```java
// LoginServlet.java
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) {
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        
        // 调用业务逻辑类
        UserService userService = new UserService();
        boolean loginSuccess = userService.validateUser(username, password);
        
        if (loginSuccess) {
            request.setAttribute("message", "登录成功");
            request.getRequestDispatcher("/success.jsp").forward(request, response);
        } else {
            request.setAttribute("error", "用户名或密码错误");
            request.getRequestDispatcher("/login.jsp").forward(request, response);
        }
    }
}
```

**2. JSP只负责显示**：
```jsp
<h2>登录结果</h2>
<% if (request.getAttribute("message") != null) { %>
    <p style="color: green;"><%= request.getAttribute("message") %></p>
<% } %>
<% if (request.getAttribute("error") != null) { %>
    <p style="color: red;"><%= request.getAttribute("error") %></p>
<% } %>
```

---

## 5. 🤝 JSP与Servlet分工原则


### 5.1 标准的MVC架构


```
MVC架构图：
┌─────────────────────────────────────────────────────────┐
│                        浏览器                            │
└──────────────────┬──────────────────────────────────────┘
                   │ HTTP请求
                   ▼
┌─────────────────────────────────────────────────────────┐
│                    Controller                           │
│                   (Servlet)                            │
│  • 接收请求                                             │
│  • 调用业务逻辑                                         │
│  • 选择视图                                             │
└──────────────────┬──────────────────┬───────────────────┘
                   │                  │
                   │ 调用              │ 转发
                   ▼                  ▼
┌─────────────────────────────────┐  ┌──────────────────┐
│            Model                │  │       View       │
│         (Business Logic)        │  │      (JSP)       │
│  • 数据处理                      │  │  • 页面展示      │
│  • 业务规则                      │  │  • 数据显示      │
│  • 数据库操作                    │  │                  │
└─────────────────────────────────┘  └──────────────────┘
```

### 5.2 职责分工详解


**🎯 Servlet的职责（Controller）**：
```
✅ 应该做的事情：
• 接收用户请求参数
• 验证请求数据格式
• 调用业务逻辑处理数据
• 根据处理结果选择合适的页面
• 将处理结果传递给JSP

❌ 不应该做的事情：
• 不写HTML代码
• 不直接操作HTML标签
• 不负责页面美化
```

**🎨 JSP的职责（View）**：
```
✅ 应该做的事情：
• 展示HTML页面
• 显示Servlet传递的数据
• 简单的数据格式化
• 简单的条件显示逻辑

❌ 不应该做的事情：
• 不处理复杂业务逻辑
• 不直接操作数据库
• 不进行数据验证
• 不处理用户认证
```

### 5.3 实际项目示例


**场景**：用户查看商品列表

**1️⃣ 用户访问商品页面**：
```
用户在浏览器输入：http://localhost:8080/shop/products
```

**2️⃣ Servlet处理请求**：
```java
@WebServlet("/products")
public class ProductServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) {
        // 1. 获取请求参数
        String category = request.getParameter("category");
        
        // 2. 调用业务逻辑
        ProductService productService = new ProductService();
        List<Product> products = productService.getProductsByCategory(category);
        
        // 3. 将数据传递给JSP
        request.setAttribute("products", products);
        request.setAttribute("category", category);
        
        // 4. 转发到JSP页面
        request.getRequestDispatcher("/products.jsp").forward(request, response);
    }
}
```

**3️⃣ JSP展示数据**：
```jsp
<%@ page import="java.util.List,com.example.Product" %>

<h1><%= request.getAttribute("category") %>商品列表</h1>

<table>
    <tr><th>商品名称</th><th>价格</th><th>库存</th></tr>
    <%
        List<Product> products = (List<Product>) request.getAttribute("products");
        if (products != null && products.size() > 0) {
            for (Product product : products) {
    %>
    <tr>
        <td><%= product.getName() %></td>
        <td>￥<%= product.getPrice() %></td>
        <td><%= product.getStock() %></td>
    </tr>
    <%
            }
        } else {
    %>
    <tr><td colspan="3">暂无商品</td></tr>
    <%
        }
    %>
</table>
```

### 5.4 分工的好处


| 好处类型 | **具体优势** | **实际效果** |
|---------|-------------|-------------|
| 🔧 **开发效率** | `前端和后端可以并行开发` | `项目进度更快` |
| 🛠️ **维护性** | `修改页面不影响业务逻辑` | `维护成本降低` |
| 🔄 **重用性** | `业务逻辑可以被多个页面使用` | `减少重复代码` |
| 🧪 **测试性** | `可以单独测试业务逻辑` | `bug更容易发现` |
| 👥 **团队协作** | `职责清晰，分工明确` | `减少开发冲突` |

---

## 6. 📋 核心要点总结


### 6.1 必须掌握的核心概念


```
🔸 JSP三种Java代码形式：<% %>脚本片段、<%= %>表达式、<%! %>声明
🔸 脚本片段：用于编写Java逻辑，如条件判断、循环处理
🔸 变量作用域：局部变量每次独立，成员变量多用户共享
🔸 职责分离：JSP负责展示，Servlet负责业务处理
🔸 MVC架构：Controller(Servlet) + Model(业务逻辑) + View(JSP)
```

### 6.2 关键理解要点


**🔹 什么时候在JSP中写Java代码**：
```
✅ 适合的场景：
• 简单的数据显示格式化
• 基本的条件判断（显示/隐藏内容）
• 简单的循环显示数据
• 获取和显示request中的数据

❌ 不适合的场景：
• 数据库操作
• 复杂的业务逻辑计算
• 用户权限验证
• 文件上传处理
```

**🔹 记忆口诀**：
```
JSP写页面，Servlet管逻辑
数据处理交给后台，展示美化交给前端
简单判断JSP可以，复杂业务必须分离
职责清晰好维护，团队合作效率高
```

### 6.3 实际开发建议


**💡 新手学习路径**：
1. 先学会在JSP中写简单Java代码
2. 理解什么是业务逻辑，什么是展示逻辑
3. 学会Servlet处理请求的基本方法
4. 练习Servlet和JSP的配合使用
5. 逐步建立MVC架构的思维

**🚨 常见新手错误**：
- **把所有逻辑都写在JSP里** → 应该：复杂逻辑写在Servlet中
- **JSP和Servlet职责不清** → 应该：明确分工，各司其职
- **不理解作用域概念** → 应该：搞清楚局部变量和成员变量的区别

**核心记忆**：
- JSP中的Java代码有三种形式，各有不同用途
- 简单逻辑可以写在JSP中，复杂业务必须分离到Servlet
- MVC架构让代码更清晰，维护更容易
- 职责分离是Web开发的基本原则