---
title: 1ã€Filter-å­—ç¬¦ç¼–ç ç»Ÿä¸€å¤„ç†
---
## ğŸ“š ç›®å½•

1. [ä¸­æ–‡ä¹±ç é—®é¢˜çš„æ ¹æœ¬åŸå› ](#1-ä¸­æ–‡ä¹±ç é—®é¢˜çš„æ ¹æœ¬åŸå› )
2. [è¯·æ±‚ç¼–ç è®¾ç½®è¯¦è§£](#2-è¯·æ±‚ç¼–ç è®¾ç½®è¯¦è§£)
3. [å“åº”ç¼–ç è®¾ç½®è¯¦è§£](#3-å“åº”ç¼–ç è®¾ç½®è¯¦è§£)
4. [UTF-8ç¼–ç ç»Ÿä¸€æ–¹æ¡ˆ](#4-UTF-8ç¼–ç ç»Ÿä¸€æ–¹æ¡ˆ)
5. [ç¼–ç è¿‡æ»¤å™¨å®Œæ•´å®ç°](#5-ç¼–ç è¿‡æ»¤å™¨å®Œæ•´å®ç°)
6. [å›½é™…åŒ–æ”¯æŒæœºåˆ¶](#6-å›½é™…åŒ–æ”¯æŒæœºåˆ¶)
7. [ç¼–ç æ£€æµ‹ä¸è‡ªé€‚åº”](#7-ç¼–ç æ£€æµ‹ä¸è‡ªé€‚åº”)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä¸­æ–‡ä¹±ç é—®é¢˜çš„æ ¹æœ¬åŸå› 


### 1.1 ä»€ä¹ˆæ˜¯å­—ç¬¦ç¼–ç ä¹±ç 


> ğŸ’¡ **é€šä¿—ç†è§£**  
> æƒ³è±¡ä¸€ä¸‹ä½ å†™äº†ä¸€å°ä¸­æ–‡ä¿¡ï¼Œä½†æ˜¯æ”¶ä¿¡äººç”¨è‹±æ–‡çš„æ–¹å¼æ¥è¯»ï¼Œç»“æœå°±çœ‹ä¸æ‡‚äº†ã€‚å­—ç¬¦ç¼–ç ä¹±ç å°±æ˜¯è¿™ä¸ªé“ç† - æ•°æ®ç”¨ä¸€ç§ç¼–ç ä¿å­˜ï¼Œå´ç”¨å¦ä¸€ç§ç¼–ç æ¥è¯»å–ã€‚

**ä¹±ç çš„æœ¬è´¨**ï¼š
```
åŸå§‹ä¸­æ–‡ï¼šä½ å¥½
UTF-8ç¼–ç ï¼š[E4, BD, A0, E5, A5, BD] 
å¦‚æœç”¨GBKè¯»å–ï¼šæµ£çŠ²ã‚½ (ä¹±ç )
å¦‚æœç”¨ISO-8859-1è¯»å–ï¼šÃ¤Â½ Ã¥Â¥Â½ (ä¹±ç )
```

### 1.2 JavaWebä¸­ä¹±ç äº§ç”Ÿçš„ç¯èŠ‚


```
æµè§ˆå™¨ â†’ æœåŠ¡å™¨ â†’ Javaåº”ç”¨ â†’ æ•°æ®åº“
  â†“        â†“        â†“        â†“
ç¼–ç A      ç¼–ç B     ç¼–ç C    ç¼–ç D

ä»»ä½•ä¸€ä¸ªç¯èŠ‚ç¼–ç ä¸ä¸€è‡´ï¼Œå°±ä¼šå‡ºç°ä¹±ç ï¼
```

**å¸¸è§ä¹±ç åœºæ™¯**ï¼š
- ğŸŒ **æµè§ˆå™¨æäº¤è¡¨å•**ï¼šç”¨æˆ·è¾“å…¥ä¸­æ–‡ï¼ŒæœåŠ¡å™¨æ¥æ”¶ä¹±ç 
- ğŸ“ **é¡µé¢æ˜¾ç¤ºå†…å®¹**ï¼šæ•°æ®åº“ä¸­æ–‡æ­£å¸¸ï¼Œé¡µé¢æ˜¾ç¤ºä¹±ç 
- ğŸ“ **æ–‡ä»¶è¯»å†™æ“ä½œ**ï¼šé…ç½®æ–‡ä»¶ä¸­æ–‡æ³¨é‡Šå˜ä¹±ç 
- ğŸ”— **URLå‚æ•°ä¼ é€’**ï¼šåœ°å€æ ä¸­æ–‡å‚æ•°ä¹±ç 

### 1.3 ç¼–ç ä¸ä¸€è‡´çš„æ ¹æœ¬é—®é¢˜


| ç¯èŠ‚ | **é»˜è®¤ç¼–ç ** | **é—®é¢˜è¡¨ç°** | **å½±å“èŒƒå›´** |
|------|-------------|-------------|-------------|
| **æµè§ˆå™¨** | `æ ¹æ®é¡µé¢charsetå†³å®š` | `æäº¤è¡¨å•ä¹±ç ` | `ç”¨æˆ·è¾“å…¥æ•°æ®` |
| **Tomcat** | `ISO-8859-1` | `æ¥æ”¶è¯·æ±‚ä¹±ç ` | `æ‰€æœ‰è¯·æ±‚æ•°æ®` |
| **Java** | `å¹³å°é»˜è®¤ç¼–ç ` | `å­—ç¬¦ä¸²å¤„ç†ä¹±ç ` | `å†…å­˜ä¸­æ•°æ®` |
| **æ•°æ®åº“** | `æ•°æ®åº“å­—ç¬¦é›†` | `å­˜å‚¨æŸ¥è¯¢ä¹±ç ` | `æŒä¹…åŒ–æ•°æ®` |

---

## 2. ğŸ“¥ è¯·æ±‚ç¼–ç è®¾ç½®è¯¦è§£


### 2.1 GETè¯·æ±‚ç¼–ç å¤„ç†


**GETè¯·æ±‚çš„ç‰¹æ®Šæ€§**ï¼š
- å‚æ•°åœ¨URLä¸­ï¼Œé€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’
- ç¼–ç æ–¹å¼ç”±æµè§ˆå™¨å’ŒæœåŠ¡å™¨é…ç½®å†³å®š
- Tomcaté»˜è®¤ç”¨ISO-8859-1è§£ç 

```
æµè§ˆå™¨å‘é€ï¼šhttp://localhost/search?keyword=ä¸­æ–‡
å®é™…ä¼ è¾“ï¼šhttp://localhost/search?keyword=%E4%B8%AD%E6%96%87
æœåŠ¡å™¨æ¥æ”¶ï¼šéœ€è¦æ­£ç¡®è§£ç æ‰èƒ½å¾—åˆ°"ä¸­æ–‡"
```

**è§£å†³æ–¹æ¡ˆå¯¹æ¯”**ï¼š

```java
// âŒ é”™è¯¯æ–¹å¼ï¼šç›´æ¥è·å–ï¼Œä¼šä¹±ç 
String keyword = request.getParameter("keyword");
System.out.println(keyword); // è¾“å‡ºä¹±ç 

// âœ… æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨è½¬ç 
String keyword = request.getParameter("keyword");
keyword = new String(keyword.getBytes("ISO-8859-1"), "UTF-8");

// âœ… æ–¹å¼äºŒï¼šåœ¨è¿‡æ»¤å™¨ä¸­ç»Ÿä¸€å¤„ç†ï¼ˆæ¨èï¼‰
request.setCharacterEncoding("UTF-8");
```

### 2.2 POSTè¯·æ±‚ç¼–ç å¤„ç†


**POSTè¯·æ±‚ç¼–ç è®¾ç½®**ï¼š
- æ•°æ®åœ¨è¯·æ±‚ä½“ä¸­ï¼Œå¯ä»¥ç›´æ¥è®¾ç½®ç¼–ç 
- **å…³é”®ç‚¹**ï¼šå¿…é¡»åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨`getParameter()`ä¹‹å‰è®¾ç½®

```java
// ğŸ”´ æ³¨æ„ï¼šå¿…é¡»åœ¨è·å–ä»»ä½•å‚æ•°ä¹‹å‰è°ƒç”¨
request.setCharacterEncoding("UTF-8");

// ç°åœ¨è·å–å‚æ•°å°±ä¸ä¼šä¹±ç äº†
String username = request.getParameter("username");
String content = request.getParameter("content");
```

### 2.3 è¯·æ±‚ç¼–ç çš„æœ€ä½³å®è·µ


```
è¯·æ±‚ç¼–ç å¤„ç†æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨æäº¤  â”‚
â”‚   (UTF-8)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    âŒ ä¸è®¾ç½®ç¼–ç 
â”‚   æœåŠ¡å™¨     â”‚ â”€â”€â†’ ISO-8859-1è§£ç  â†’ ä¹±ç 
â”‚  (Tomcat)   â”‚    
â”‚             â”‚    âœ… è®¾ç½®UTF-8ç¼–ç 
â”‚             â”‚ â”€â”€â†’ UTF-8è§£ç  â†’ æ­£å¸¸ä¸­æ–‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸ“¤ å“åº”ç¼–ç è®¾ç½®è¯¦è§£


### 3.1 å“åº”ç¼–ç çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®å“åº”ç¼–ç **ï¼š
- å‘Šè¯‰æµè§ˆå™¨ç”¨ä»€ä¹ˆç¼–ç æ˜¾ç¤ºå†…å®¹
- é˜²æ­¢æµè§ˆå™¨è‡ªåŠ¨çŒœæµ‹ç¼–ç å¯¼è‡´ä¹±ç 
- ç¡®ä¿ä¸­æ–‡å†…å®¹æ­£ç¡®æ˜¾ç¤º

### 3.2 å“åº”ç¼–ç è®¾ç½®æ–¹æ³•


**æ–¹æ³•å¯¹æ¯”åˆ†æ**ï¼š

```java
// æ–¹å¼ä¸€ï¼šåˆ†åˆ«è®¾ç½®å†…å®¹ç±»å‹å’Œç¼–ç 
response.setContentType("text/html");
response.setCharacterEncoding("UTF-8");

// æ–¹å¼äºŒï¼šä¸€æ¬¡æ€§è®¾ç½®ï¼ˆæ¨èï¼‰
response.setContentType("text/html;charset=UTF-8");

// æ–¹å¼ä¸‰ï¼šé€šè¿‡å“åº”å¤´è®¾ç½®
response.setHeader("Content-Type", "text/html;charset=UTF-8");
```

**è®¾ç½®æ—¶æœºè¦æ±‚**ï¼š
```java
// âœ… æ­£ç¡®ï¼šåœ¨å†™å…¥å†…å®¹ä¹‹å‰è®¾ç½®
response.setContentType("text/html;charset=UTF-8");
PrintWriter out = response.getWriter();
out.println("ä¸­æ–‡å†…å®¹");

// âŒ é”™è¯¯ï¼šåœ¨å†™å…¥å†…å®¹ä¹‹åè®¾ç½®ï¼Œæ— æ•ˆ
PrintWriter out = response.getWriter();
out.println("ä¸­æ–‡å†…å®¹");
response.setContentType("text/html;charset=UTF-8"); // å¤ªæ™šäº†ï¼
```

### 3.3 ä¸åŒå†…å®¹ç±»å‹çš„ç¼–ç è®¾ç½®


| å†…å®¹ç±»å‹ | **è®¾ç½®æ–¹å¼** | **ä½¿ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| **HTMLé¡µé¢** | `text/html;charset=UTF-8` | `ç½‘é¡µæ˜¾ç¤º` |
| **JSONæ•°æ®** | `application/json;charset=UTF-8` | `Ajaxå“åº”` |
| **çº¯æ–‡æœ¬** | `text/plain;charset=UTF-8` | `æ–‡æœ¬ä¸‹è½½` |
| **XMLæ–‡æ¡£** | `text/xml;charset=UTF-8` | `XMLå“åº”` |

---

## 4. ğŸŒ UTF-8ç¼–ç ç»Ÿä¸€æ–¹æ¡ˆ


### 4.1 ä¸ºä»€ä¹ˆé€‰æ‹©UTF-8


**UTF-8çš„ä¼˜åŠ¿**ï¼š
```
ç¼–ç å¯¹æ¯”åˆ†æï¼š

GBKç¼–ç ï¼š
â”œâ”€ åªæ”¯æŒä¸­æ–‡å’Œè‹±æ–‡
â”œâ”€ ä¸­æ–‡å 2å­—èŠ‚
â””â”€ ä¸æ”¯æŒå…¶ä»–è¯­è¨€æ–‡å­—

UTF-8ç¼–ç ï¼š
â”œâ”€ æ”¯æŒå…¨ä¸–ç•Œæ‰€æœ‰æ–‡å­—
â”œâ”€ ä¸­æ–‡å 3å­—èŠ‚
â”œâ”€ è‹±æ–‡å 1å­—èŠ‚
â””â”€ å›½é™…åŒ–æ ‡å‡†
```

> ğŸ“‹ **ä¸ºä»€ä¹ˆUTF-8æ˜¯æœ€ä½³é€‰æ‹©**  
> å°±åƒæ™®é€šè¯æ˜¯å…¨å›½é€šç”¨è¯­è¨€ä¸€æ ·ï¼ŒUTF-8æ˜¯å…¨ä¸–ç•Œé€šç”¨çš„å­—ç¬¦ç¼–ç ã€‚ç”¨å®ƒå¯ä»¥å¤„ç†ä»»ä½•è¯­è¨€çš„æ–‡å­—ï¼Œä¸ç”¨æ‹…å¿ƒä»¥åç½‘ç«™è¦æ”¯æŒå…¶ä»–è¯­è¨€æ—¶å‡ºé—®é¢˜ã€‚

### 4.2 å…¨é“¾è·¯UTF-8ç»Ÿä¸€é…ç½®


**å®Œæ•´çš„ç¼–ç ç»Ÿä¸€æ–¹æ¡ˆ**ï¼š

```
ğŸ“ é¡¹ç›®ç¼–ç ç»Ÿä¸€æ£€æŸ¥æ¸…å•ï¼š

âœ… IDEè®¾ç½®ï¼š
   - æ–‡ä»¶ç¼–ç ï¼šUTF-8
   - é¡¹ç›®ç¼–ç ï¼šUTF-8
   
âœ… WebæœåŠ¡å™¨ï¼š
   - Tomcat URIEncoding="UTF-8"
   - è¿æ¥å™¨ç¼–ç é…ç½®
   
âœ… æ•°æ®åº“ï¼š
   - æ•°æ®åº“å­—ç¬¦é›†ï¼šutf8mb4
   - è¿æ¥å­—ç¬¦é›†ï¼šUTF-8
   
âœ… é¡µé¢è®¾ç½®ï¼š
   - HTML meta charset="UTF-8"
   - JSP pageEncoding="UTF-8"
```

### 4.3 TomcatæœåŠ¡å™¨ç¼–ç é…ç½®


**server.xmlé…ç½®ç¤ºä¾‹**ï¼š
```xml
<!-- é…ç½®HTTPè¿æ¥å™¨çš„ç¼–ç  -->
<Connector port="8080" 
           protocol="HTTP/1.1"
           connectionTimeout="20000"
           redirectPort="8443"
           URIEncoding="UTF-8"
           useBodyEncodingForURI="true" />
```

**é…ç½®è¯´æ˜**ï¼š
- `URIEncoding="UTF-8"`ï¼šè®¾ç½®GETè¯·æ±‚URLç¼–ç 
- `useBodyEncodingForURI="true"`ï¼šPOSTè¯·æ±‚ç¼–ç ä¹Ÿç”¨äºURI

---

## 5. ğŸ”§ ç¼–ç è¿‡æ»¤å™¨å®Œæ•´å®ç°


### 5.1 ç¼–ç è¿‡æ»¤å™¨çš„è®¾è®¡æ€è·¯


**è¿‡æ»¤å™¨è§£å†³ç¼–ç é—®é¢˜çš„ä¼˜åŠ¿**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼šæ¯ä¸ªServletéƒ½è¦è®¾ç½®ç¼–ç 
    â†“
Servlet1 â†’ è®¾ç½®ç¼–ç  â†’ å¤„ç†è¯·æ±‚
Servlet2 â†’ è®¾ç½®ç¼–ç  â†’ å¤„ç†è¯·æ±‚  â† é‡å¤ä»£ç 
Servlet3 â†’ è®¾ç½®ç¼–ç  â†’ å¤„ç†è¯·æ±‚

è¿‡æ»¤å™¨æ–¹å¼ï¼šç»Ÿä¸€åœ¨è¿‡æ»¤å™¨ä¸­å¤„ç†
    â†“
è¿‡æ»¤å™¨ â†’ è®¾ç½®ç¼–ç  â†’ Servlet1/2/3  â† ä¸€æ¬¡è®¾ç½®ï¼Œå…¨å±€ç”Ÿæ•ˆ
```

### 5.2 åŸºç¡€ç¼–ç è¿‡æ»¤å™¨å®ç°


```java
@WebFilter("/*")
public class EncodingFilter implements Filter {
    
    private String encoding = "UTF-8"; // é»˜è®¤ç¼–ç 
    
    @Override
    public void init(FilterConfig config) {
        // ä»é…ç½®ä¸­è¯»å–ç¼–ç ï¼Œå¦‚æœæ²¡æœ‰é…ç½®å°±ç”¨é»˜è®¤å€¼
        String configEncoding = config.getInitParameter("encoding");
        if (configEncoding != null && !configEncoding.isEmpty()) {
            this.encoding = configEncoding;
        }
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // è®¾ç½®è¯·æ±‚ç¼–ç 
        request.setCharacterEncoding(encoding);
        
        // è®¾ç½®å“åº”ç¼–ç 
        response.setContentType("text/html;charset=" + encoding);
        
        // ç»§ç»­æ‰§è¡Œåç»­å¤„ç†
        chain.doFilter(request, response);
    }
}
```

### 5.3 å¢å¼ºç‰ˆç¼–ç è¿‡æ»¤å™¨


```java
@WebFilter(urlPatterns = "/*", 
           initParams = @WebInitParam(name = "encoding", value = "UTF-8"))
public class AdvancedEncodingFilter implements Filter {
    
    private String encoding;
    private boolean forceEncoding = false;
    
    @Override
    public void init(FilterConfig config) {
        // è¯»å–ç¼–ç é…ç½®
        encoding = config.getInitParameter("encoding");
        if (encoding == null) {
            encoding = "UTF-8"; // é»˜è®¤ç¼–ç 
        }
        
        // æ˜¯å¦å¼ºåˆ¶è®¾ç½®ç¼–ç 
        String force = config.getInitParameter("forceEncoding");
        forceEncoding = "true".equalsIgnoreCase(force);
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // å¤„ç†è¯·æ±‚ç¼–ç 
        if (forceEncoding || request.getCharacterEncoding() == null) {
            request.setCharacterEncoding(encoding);
        }
        
        // å¤„ç†å“åº”ç¼–ç 
        if (forceEncoding || response.getCharacterEncoding().equals("ISO-8859-1")) {
            response.setCharacterEncoding(encoding);
        }
        
        // è®¾ç½®å“åº”å†…å®¹ç±»å‹
        if (response.getContentType() == null) {
            response.setContentType("text/html;charset=" + encoding);
        }
        
        chain.doFilter(request, response);
    }
}
```

### 5.4 web.xmlé…ç½®æ–¹å¼


```xml
<!-- ç¼–ç è¿‡æ»¤å™¨é…ç½® -->
<filter>
    <filter-name>EncodingFilter</filter-name>
    <filter-class>com.example.filter.EncodingFilter</filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
    <init-param>
        <param-name>forceEncoding</param-name>
        <param-value>true</param-value>
    </init-param>
</filter>
<filter-mapping>
    <filter-name>EncodingFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

---

## 6. ğŸŒ å›½é™…åŒ–æ”¯æŒæœºåˆ¶


### 6.1 å›½é™…åŒ–çš„åŸºæœ¬æ¦‚å¿µ


> ğŸ’¡ **ä»€ä¹ˆæ˜¯å›½é™…åŒ–**  
> å›½é™…åŒ–å°±åƒè®©ä½ çš„ç½‘ç«™å­¦ä¼šå¤šç§è¯­è¨€ã€‚åŒä¸€ä¸ªç½‘ç«™ï¼Œä¸­å›½ç”¨æˆ·çœ‹åˆ°ä¸­æ–‡ï¼Œç¾å›½ç”¨æˆ·çœ‹åˆ°è‹±æ–‡ï¼Œæ—¥æœ¬ç”¨æˆ·çœ‹åˆ°æ—¥æ–‡ã€‚ç¨‹åºä¼šæ ¹æ®ç”¨æˆ·çš„è¯­è¨€åå¥½è‡ªåŠ¨åˆ‡æ¢æ˜¾ç¤ºå†…å®¹ã€‚

**å›½é™…åŒ–æ¶‰åŠçš„ç¼–ç é—®é¢˜**ï¼š
```
ç”¨æˆ·è¯­è¨€ç¯å¢ƒ â†’ æµè§ˆå™¨å‘é€ â†’ æœåŠ¡å™¨è¯†åˆ« â†’ é€‰æ‹©å¯¹åº”ç¼–ç 

ä¸­æ–‡ç”¨æˆ·ï¼š
Accept-Language: zh-CN â†’ UTF-8ç¼–ç  â†’ ä¸­æ–‡å†…å®¹

è‹±æ–‡ç”¨æˆ·ï¼š  
Accept-Language: en-US â†’ UTF-8ç¼–ç  â†’ è‹±æ–‡å†…å®¹

æ—¥æ–‡ç”¨æˆ·ï¼š
Accept-Language: ja-JP â†’ UTF-8ç¼–ç  â†’ æ—¥æ–‡å†…å®¹
```

### 6.2 æ”¯æŒå›½é™…åŒ–çš„ç¼–ç è¿‡æ»¤å™¨


```java
@WebFilter("/*")
public class I18nEncodingFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // è·å–ç”¨æˆ·é¦–é€‰è¯­è¨€
        String acceptLanguage = httpRequest.getHeader("Accept-Language");
        
        // è®¾ç½®è¯·æ±‚ç¼–ç ä¸ºUTF-8ï¼ˆæ”¯æŒæ‰€æœ‰è¯­è¨€ï¼‰
        request.setCharacterEncoding("UTF-8");
        
        // æ ¹æ®ç”¨æˆ·è¯­è¨€è®¾ç½®å“åº”
        if (acceptLanguage != null && acceptLanguage.startsWith("zh")) {
            // ä¸­æ–‡ç”¨æˆ·
            response.setContentType("text/html;charset=UTF-8");
        } else {
            // å…¶ä»–è¯­è¨€ç”¨æˆ·ï¼ˆUTF-8é€šç”¨ï¼‰
            response.setContentType("text/html;charset=UTF-8");
        }
        
        chain.doFilter(request, response);
    }
}
```

### 6.3 å¤šè¯­è¨€ç¼–ç å¤„ç†ç­–ç•¥


| è¯­è¨€ç±»å‹ | **å­—ç¬¦é›†** | **ç¼–ç æ–¹å¼** | **å¤„ç†ç­–ç•¥** |
|---------|-----------|-------------|-------------|
| **ä¸­æ—¥éŸ©æ–‡å­—** | `UTF-8` | `3å­—èŠ‚ç¼–ç ` | `ç»Ÿä¸€UTF-8å¤„ç†` |
| **æ¬§æ´²æ–‡å­—** | `UTF-8` | `1-2å­—èŠ‚ç¼–ç ` | `UTF-8å…¼å®¹å¤„ç†` |
| **é˜¿æ‹‰ä¼¯æ–‡å­—** | `UTF-8` | `å˜é•¿ç¼–ç ` | `UTF-8åŒå‘æ˜¾ç¤º` |
| **æ‰€æœ‰æ–‡å­—** | `UTF-8` | `é€šç”¨ç¼–ç ` | `æ¨èä½¿ç”¨` |

---

## 7. ğŸ” ç¼–ç æ£€æµ‹ä¸è‡ªé€‚åº”


### 7.1 è‡ªåŠ¨ç¼–ç æ£€æµ‹åŸç†


**ç¼–ç æ£€æµ‹çš„æ€è·¯**ï¼š
```
æ¥æ”¶æ•°æ® â†’ å°è¯•ä¸åŒç¼–ç è§£æ â†’ æ£€æµ‹æ˜¯å¦æœ‰ä¹±ç  â†’ é€‰æ‹©æ­£ç¡®ç¼–ç 

æ£€æµ‹æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¥æ”¶å­—èŠ‚æµ  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ UTF-8 â”‚â”€â”€â”€â†’â”‚ æ£€æµ‹ç»“æœ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  GBK  â”‚â”€â”€â”€â†’â”‚ æ£€æµ‹ç»“æœ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ISO-8859â”‚â”€â”€â”€â†’â”‚ æ£€æµ‹ç»“æœ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç¼–ç æ£€æµ‹å·¥å…·å®ç°


```java
public class EncodingDetector {
    
    /**
     * æ£€æµ‹å­—ç¬¦ä¸²çš„å¯èƒ½ç¼–ç 
     */
    public static String detectEncoding(byte[] bytes) {
        String[] encodings = {"UTF-8", "GBK", "GB2312", "ISO-8859-1"};
        
        for (String encoding : encodings) {
            try {
                String text = new String(bytes, encoding);
                
                // ç®€å•æ£€æµ‹ï¼šå¦‚æœè½¬æ¢ååŒ…å«å¸¸è§ä¸­æ–‡å­—ç¬¦ï¼Œå¯èƒ½æ˜¯æ­£ç¡®ç¼–ç 
                if (encoding.equals("UTF-8") || encoding.equals("GBK")) {
                    if (containsChineseChar(text)) {
                        return encoding;
                    }
                }
                
                // å¯¹äºè‹±æ–‡ç­‰ï¼ŒUTF-8é€šå¸¸æ˜¯æœ€å¥½çš„é€‰æ‹©
                if (!containsInvalidChar(text)) {
                    return encoding;
                }
                
            } catch (UnsupportedEncodingException e) {
                // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªç¼–ç 
                continue;
            }
        }
        
        return "UTF-8"; // é»˜è®¤è¿”å›UTF-8
    }
    
    /**
     * æ£€æµ‹æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦
     */
    private static boolean containsChineseChar(String text) {
        for (char ch : text.toCharArray()) {
            if (ch >= 0x4e00 && ch <= 0x9fa5) {
                return true; // åŸºæœ¬æ±‰å­—åŒºé—´
            }
        }
        return false;
    }
    
    /**
     * æ£€æµ‹æ˜¯å¦åŒ…å«æ— æ•ˆå­—ç¬¦
     */
    private static boolean containsInvalidChar(String text) {
        return text.contains("ï¿½") || text.contains("?");
    }
}
```

### 7.3 è‡ªé€‚åº”ç¼–ç è¿‡æ»¤å™¨


```java
@WebFilter("/*")
public class AdaptiveEncodingFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        
        // è·å–è¯·æ±‚ä¸­çš„ç¼–ç ä¿¡æ¯
        String contentType = httpRequest.getContentType();
        String userAgent = httpRequest.getHeader("User-Agent");
        
        // æ ¹æ®å®¢æˆ·ç«¯ä¿¡æ¯æ™ºèƒ½é€‰æ‹©ç¼–ç 
        String encoding = determineEncoding(contentType, userAgent);
        
        // è®¾ç½®ç¼–ç 
        request.setCharacterEncoding(encoding);
        response.setContentType("text/html;charset=" + encoding);
        
        chain.doFilter(request, response);
    }
    
    private String determineEncoding(String contentType, String userAgent) {
        // å¦‚æœContent-Typeä¸­å·²ç»æŒ‡å®šäº†ç¼–ç ï¼Œä¼˜å…ˆä½¿ç”¨
        if (contentType != null && contentType.contains("charset=")) {
            String charset = contentType.substring(contentType.indexOf("charset=") + 8);
            if (charset.contains(";")) {
                charset = charset.substring(0, charset.indexOf(";"));
            }
            return charset.trim();
        }
        
        // æ ¹æ®User-Agentåˆ¤æ–­
        if (userAgent != null) {
            if (userAgent.contains("Windows")) {
                // Windowsç”¨æˆ·ï¼Œå¯èƒ½ä½¿ç”¨GBK
                return "UTF-8"; // ä½†è¿˜æ˜¯æ¨èUTF-8
            }
        }
        
        // é»˜è®¤ä½¿ç”¨UTF-8
        return "UTF-8";
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç¼–ç ä¹±ç æœ¬è´¨ï¼šæ•°æ®ç”¨ä¸€ç§ç¼–ç ä¿å­˜ï¼Œç”¨å¦ä¸€ç§ç¼–ç è¯»å–
ğŸ”¸ è¯·æ±‚ç¼–ç å¤„ç†ï¼šPOSTè¯·æ±‚å¯ç›´æ¥è®¾ç½®ï¼ŒGETè¯·æ±‚éœ€ç‰¹æ®Šå¤„ç†
ğŸ”¸ å“åº”ç¼–ç è®¾ç½®ï¼šå‘Šè¯‰æµè§ˆå™¨ç”¨ä»€ä¹ˆç¼–ç æ˜¾ç¤ºå†…å®¹
ğŸ”¸ UTF-8ç»Ÿä¸€æ–¹æ¡ˆï¼šå…¨é“¾è·¯ä½¿ç”¨UTF-8ç¼–ç ï¼Œæ”¯æŒå›½é™…åŒ–
ğŸ”¸ è¿‡æ»¤å™¨ç»Ÿä¸€å¤„ç†ï¼šä¸€æ¬¡é…ç½®ï¼Œå…¨å±€ç”Ÿæ•ˆï¼Œé¿å…é‡å¤ä»£ç 
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç¼–ç é—®é¢˜çš„æ ¹æº**
```
ç†è§£è¦ç‚¹ï¼š
- ç¼–ç ä¸ç»Ÿä¸€æ˜¯ä¹±ç çš„æ ¹æœ¬åŸå› 
- æ¯ä¸ªç¯èŠ‚éƒ½è¦ä¿è¯ç¼–ç ä¸€è‡´
- UTF-8æ˜¯æœ€ä½³çš„ç»Ÿä¸€ç¼–ç é€‰æ‹©
```

**ğŸ”¹ è¿‡æ»¤å™¨å¤„ç†ç¼–ç çš„ä¼˜åŠ¿**
```
ä¼˜åŠ¿åˆ†æï¼š
âœ… ç»Ÿä¸€å¤„ç†ï¼šæ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡ç¼–ç è®¾ç½®
âœ… ä»£ç å¤ç”¨ï¼šé¿å…åœ¨æ¯ä¸ªServletä¸­é‡å¤è®¾ç½®
âœ… ç»´æŠ¤æ–¹ä¾¿ï¼šä¿®æ”¹ç¼–ç åªéœ€æ”¹è¿‡æ»¤å™¨é…ç½®
âœ… å…¨å±€ç”Ÿæ•ˆï¼šä¸€æ¬¡é…ç½®å½±å“æ•´ä¸ªåº”ç”¨
```

**ğŸ”¹ ç¼–ç è®¾ç½®çš„æ—¶æœºè¦æ±‚**
```
å…³é”®æ—¶æœºï¼š
- è¯·æ±‚ç¼–ç ï¼šå¿…é¡»åœ¨ç¬¬ä¸€æ¬¡getParameter()ä¹‹å‰è®¾ç½®
- å“åº”ç¼–ç ï¼šå¿…é¡»åœ¨getWriter()æˆ–getOutputStream()ä¹‹å‰è®¾ç½®
- æ—¶æœºé”™è¯¯ï¼šè®¾ç½®æ— æ•ˆï¼Œä»ç„¶ä¼šä¹±ç 
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… æ¨èçš„ç¼–ç å¤„ç†æ–¹æ¡ˆ**
```
1. å…¨é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨UTF-8ç¼–ç 
2. ä½¿ç”¨ç¼–ç è¿‡æ»¤å™¨ç»Ÿä¸€å¤„ç†
3. é…ç½®Tomcatæ”¯æŒUTF-8
4. æ•°æ®åº“ä½¿ç”¨utf8mb4å­—ç¬¦é›†
5. HTMLé¡µé¢æŒ‡å®šUTF-8ç¼–ç 
```

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³æ­¥éª¤**
```
ä¹±ç æ’æŸ¥æµç¨‹ï¼š
1ï¸âƒ£ æ£€æŸ¥é¡µé¢metaæ ‡ç­¾æ˜¯å¦è®¾ç½®UTF-8
2ï¸âƒ£ ç¡®è®¤è¿‡æ»¤å™¨æ˜¯å¦æ­£ç¡®é…ç½®å’Œç”Ÿæ•ˆ
3ï¸âƒ£ éªŒè¯Tomcatè¿æ¥å™¨ç¼–ç é…ç½®
4ï¸âƒ£ æ£€æŸ¥æ•°æ®åº“è¿æ¥å­—ç¬¦é›†è®¾ç½®
5ï¸âƒ£ ç¡®è®¤IDEå’Œé¡¹ç›®æ–‡ä»¶ç¼–ç ç»Ÿä¸€
```

### 8.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ“‹ ç¼–ç å¤„ç†æœ€ä½³å®è·µ**
- **ç»Ÿä¸€æ ‡å‡†**ï¼šå…¨é“¾è·¯ä½¿ç”¨UTF-8ï¼Œä¸è¦æ··ç”¨å¤šç§ç¼–ç 
- **é…ç½®é›†ä¸­**ï¼šåœ¨è¿‡æ»¤å™¨ä¸­ç»Ÿä¸€é…ç½®ï¼Œé¿å…åˆ†æ•£è®¾ç½®
- **åŠæ—¶è®¾ç½®**ï¼šåœ¨æ­£ç¡®çš„æ—¶æœºè®¾ç½®ç¼–ç ï¼Œé¿å…æ—¶æœºé”™è¯¯
- **æµ‹è¯•éªŒè¯**ï¼šç”¨ä¸åŒæµè§ˆå™¨å’Œè¾“å…¥æ³•æµ‹è¯•ä¸­æ–‡å¤„ç†
- **æ–‡æ¡£è®°å½•**ï¼šè®°å½•é¡¹ç›®çš„ç¼–ç é…ç½®æ ‡å‡†ï¼Œæ–¹ä¾¿å›¢é˜Ÿåä½œ

**ğŸ¯ è®°å¿†è¦ç‚¹**
- ç¼–ç ä¹±ç æºäºä¸ç»Ÿä¸€ï¼ŒUTF-8ç¼–ç è§£ä¸‡éš¾
- è¿‡æ»¤å™¨ç»Ÿä¸€å¤„ç†å¥½ï¼Œæ—¶æœºæ­£ç¡®å¾ˆé‡è¦
- è¯·æ±‚å“åº”éƒ½è¦è®¾ï¼Œå…¨é“¾è·¯ç¼–ç è¦ä¸€è‡´

**æ ¸å¿ƒåŸåˆ™**ï¼š**ç»Ÿä¸€ä½¿ç”¨UTF-8ï¼Œè¿‡æ»¤å™¨é›†ä¸­å¤„ç†ï¼Œæ³¨æ„è®¾ç½®æ—¶æœºï¼Œå…¨é“¾è·¯ä¿æŒä¸€è‡´**