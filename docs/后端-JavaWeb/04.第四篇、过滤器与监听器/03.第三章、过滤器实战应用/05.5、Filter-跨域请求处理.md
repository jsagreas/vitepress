---
title: 5ã€Filter-è·¨åŸŸè¯·æ±‚å¤„ç†
---
## ğŸ“š ç›®å½•

1. [è·¨åŸŸé—®é¢˜åŸºç¡€è®¤çŸ¥](#1-è·¨åŸŸé—®é¢˜åŸºç¡€è®¤çŸ¥)
2. [CORSè·¨åŸŸè§£å†³æ–¹æ¡ˆ](#2-CORSè·¨åŸŸè§£å†³æ–¹æ¡ˆ)
3. [è·¨åŸŸè¿‡æ»¤å™¨å®ç°](#3-è·¨åŸŸè¿‡æ»¤å™¨å®ç°)
4. [é¢„æ£€è¯·æ±‚å¤„ç†è¯¦è§£](#4-é¢„æ£€è¯·æ±‚å¤„ç†è¯¦è§£)
5. [å®‰å…¨ç­–ç•¥ä¸æœ€ä½³å®è·µ](#5-å®‰å…¨ç­–ç•¥ä¸æœ€ä½³å®è·µ)
6. [å‰åç«¯åˆ†ç¦»é¡¹ç›®åº”ç”¨](#6-å‰åç«¯åˆ†ç¦»é¡¹ç›®åº”ç”¨)
7. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#7-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ è·¨åŸŸé—®é¢˜åŸºç¡€è®¤çŸ¥


### 1.1 ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜


**è·¨åŸŸç®€å•ç†è§£**ï¼šå°±åƒä¸¤ä¸ªä¸åŒå°åŒºçš„äººäº’ç›¸ä¸²é—¨ï¼Œéœ€è¦é—¨å«æ£€æŸ¥èº«ä»½ä¸€æ ·

```
è·¨åŸŸåœºæ™¯ä¸¾ä¾‹ï¼š
å‰ç«¯é¡µé¢ï¼šhttp://localhost:3000        (å°åŒºA)
åç«¯æ¥å£ï¼šhttp://localhost:8080        (å°åŒºB)

æµè§ˆå™¨ï¼š"ä½ ä»¬ä¸æ˜¯ä¸€ä¸ªå°åŒºçš„ï¼Œæˆ‘ä¸å…è®¸ä½ ä»¬ç›´æ¥é€šä¿¡ï¼"
è¿™å°±æ˜¯è·¨åŸŸé™åˆ¶äº§ç”Ÿçš„åŸå› 
```

**ğŸ”¸ åŒæºç­–ç•¥ï¼ˆæµè§ˆå™¨çš„å®‰å…¨è§„åˆ™ï¼‰**
```
ä»€ä¹ˆå«"åŒæº"ï¼Ÿä¸‰ä¸ªæ¡ä»¶éƒ½ç›¸åŒæ‰ç®—åŒæºï¼š
âœ… åè®®ç›¸åŒï¼šéƒ½æ˜¯httpæˆ–éƒ½æ˜¯https
âœ… åŸŸåç›¸åŒï¼šéƒ½æ˜¯www.example.com
âœ… ç«¯å£ç›¸åŒï¼šéƒ½æ˜¯80ç«¯å£æˆ–éƒ½æ˜¯8080ç«¯å£

ä¸¾ä¾‹è¯´æ˜ï¼š
http://www.example.com:80/page1    â† åŸºå‡†åœ°å€
http://www.example.com:80/page2    â† âœ…åŒæºï¼ˆåè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒï¼‰
https://www.example.com:80/page1   â† âŒè·¨åŸŸï¼ˆåè®®ä¸åŒï¼‰
http://api.example.com:80/page1    â† âŒè·¨åŸŸï¼ˆåŸŸåä¸åŒï¼‰
http://www.example.com:8080/page1  â† âŒè·¨åŸŸï¼ˆç«¯å£ä¸åŒï¼‰
```

### 1.2 ä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸé™åˆ¶


**ğŸ›¡ï¸ æµè§ˆå™¨çš„å®‰å…¨è€ƒè™‘**
```
æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š
1. ä½ åœ¨é“¶è¡Œç½‘ç«™ bank.com ç™»å½•äº†è´¦æˆ·
2. åŒæ—¶æ‰“å¼€äº†æ¶æ„ç½‘ç«™ evil.com
3. å¦‚æœæ²¡æœ‰è·¨åŸŸé™åˆ¶ï¼Œæ¶æ„ç½‘ç«™å¯ä»¥ï¼š
   â†’ å·å·è°ƒç”¨é“¶è¡Œçš„API
   â†’ è½¬èµ°ä½ çš„é’±
   â†’ è·å–ä½ çš„è´¦æˆ·ä¿¡æ¯

æ‰€ä»¥æµè§ˆå™¨è¯´ï¼š"æˆ‘ä¸å…è®¸è¿™ç§å±é™©æ“ä½œï¼"
```

### 1.3 ä»€ä¹ˆæ—¶å€™ä¼šé‡åˆ°è·¨åŸŸ


**ğŸ“‹ å¸¸è§è·¨åŸŸåœºæ™¯**

| **å¼€å‘åœºæ™¯** | **å‰ç«¯åœ°å€** | **åç«¯åœ°å€** | **æ˜¯å¦è·¨åŸŸ** |
|------------|-------------|-------------|------------|
| æœ¬åœ°å¼€å‘ | `localhost:3000` | `localhost:8080` | âœ… è·¨åŸŸ |
| å‰åç«¯åˆ†ç¦» | `www.myapp.com` | `api.myapp.com` | âœ… è·¨åŸŸ |
| è°ƒç”¨ç¬¬ä¸‰æ–¹API | `mysite.com` | `api.github.com` | âœ… è·¨åŸŸ |
| åŒåŸŸéƒ¨ç½² | `myapp.com/index.html` | `myapp.com/api/data` | âŒ ä¸è·¨åŸŸ |

---

## 2. ğŸ”§ CORSè·¨åŸŸè§£å†³æ–¹æ¡ˆ


### 2.1 CORSæ˜¯ä»€ä¹ˆ


**CORSå…¨ç§°**ï¼šCross-Origin Resource Sharingï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰

**é€šä¿—è§£é‡Š**ï¼šå°±åƒç»™é—¨å«ä¸€ä»½"å…è®¸é€šè¡Œåå•"ï¼Œå‘Šè¯‰æµè§ˆå™¨å“ªäº›è·¨åŸŸè¯·æ±‚æ˜¯è¢«å…è®¸çš„

```
ä¼ ç»Ÿæ–¹å¼ï¼šæµè§ˆå™¨å®Œå…¨ç¦æ­¢è·¨åŸŸ
CORSæ–¹å¼ï¼šæœåŠ¡å™¨è¯´"è¿™ä¸ªè¯·æ±‚æˆ‘å…è®¸"ï¼Œæµè§ˆå™¨å°±æ”¾è¡Œäº†

ç±»æ¯”ç†è§£ï¼š
æµè§ˆå™¨ = ä¸¥æ ¼çš„é—¨å«
CORS = æœåŠ¡å™¨ç»™é—¨å«çš„é€šè¡Œè¯
å‰ç«¯è¯·æ±‚ = è¦è¿›é—¨çš„è®¿å®¢
```

### 2.2 CORSå·¥ä½œåŸç†


**ğŸ”„ CORSå¤„ç†æµç¨‹**
```
ç¬¬1æ­¥ï¼šå‰ç«¯å‘èµ·è·¨åŸŸè¯·æ±‚
   â†“
ç¬¬2æ­¥ï¼šæµè§ˆå™¨æ£€æŸ¥æ˜¯å¦è·¨åŸŸ
   â†“  
ç¬¬3æ­¥ï¼šå¦‚æœè·¨åŸŸï¼Œæµè§ˆå™¨æ·»åŠ Originå¤´éƒ¨
   â†“
ç¬¬4æ­¥ï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œæ£€æŸ¥Origin
   â†“
ç¬¬5æ­¥ï¼šæœåŠ¡å™¨è¿”å›CORSå¤´éƒ¨ï¼ˆå¦‚Access-Control-Allow-Originï¼‰
   â†“
ç¬¬6æ­¥ï¼šæµè§ˆå™¨æ£€æŸ¥CORSå¤´éƒ¨
   â†“
ç¬¬7æ­¥ï¼šå¦‚æœå…è®¸ï¼Œå‰ç«¯æ”¶åˆ°å“åº”ï¼›å¦‚æœä¸å…è®¸ï¼Œæµè§ˆå™¨é˜»æ­¢
```

### 2.3 æ ¸å¿ƒCORSå¤´éƒ¨è¯¦è§£


**ğŸ”¸ Access-Control-Allow-Originï¼ˆæœ€é‡è¦çš„å¤´éƒ¨ï¼‰**
```
ä½œç”¨ï¼šå‘Šè¯‰æµè§ˆå™¨å…è®¸å“ªäº›æºè®¿é—®èµ„æº

é…ç½®æ–¹å¼ï¼š
Access-Control-Allow-Origin: *                    â† å…è®¸æ‰€æœ‰æºï¼ˆä¸å®‰å…¨ï¼‰
Access-Control-Allow-Origin: http://localhost:3000 â† åªå…è®¸ç‰¹å®šæº
Access-Control-Allow-Origin: null                 â† ä¸å…è®¸ä»»ä½•æº
```

**ğŸ”¸ å…¶ä»–é‡è¦CORSå¤´éƒ¨**
```
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
â†‘ å…è®¸çš„HTTPæ–¹æ³•

Access-Control-Allow-Headers: Content-Type, Authorization
â†‘ å…è®¸çš„è¯·æ±‚å¤´éƒ¨

Access-Control-Allow-Credentials: true
â†‘ æ˜¯å¦å…è®¸æºå¸¦Cookieç­‰å‡­è¯

Access-Control-Max-Age: 3600
â†‘ é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
```

---

## 3. ğŸ’» è·¨åŸŸè¿‡æ»¤å™¨å®ç°


### 3.1 åŸºç¡€è·¨åŸŸè¿‡æ»¤å™¨


```java
@WebFilter("/*")
public class CorsFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // ğŸ”¸ è®¾ç½®å…è®¸è·¨åŸŸçš„æº
        resp.setHeader("Access-Control-Allow-Origin", "*");
        
        // ğŸ”¸ å…è®¸çš„è¯·æ±‚æ–¹æ³•
        resp.setHeader("Access-Control-Allow-Methods", 
                      "GET, POST, PUT, DELETE, OPTIONS");
        
        // ğŸ”¸ å…è®¸çš„è¯·æ±‚å¤´
        resp.setHeader("Access-Control-Allow-Headers", 
                      "Content-Type, Authorization, X-Requested-With");
        
        // ğŸ”¸ å…è®¸æºå¸¦å‡­è¯
        resp.setHeader("Access-Control-Allow-Credentials", "true");
        
        // ç»§ç»­æ‰§è¡Œåç»­è¿‡æ»¤å™¨å’ŒServlet
        chain.doFilter(request, response);
    }
}
```

> âš ï¸ **å®‰å…¨æé†’**ï¼š`Access-Control-Allow-Origin: *` è¡¨ç¤ºå…è®¸æ‰€æœ‰ç½‘ç«™è®¿é—®ï¼Œè¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼

### 3.2 åŠ¨æ€æºæ§åˆ¶è¿‡æ»¤å™¨


```java
@WebFilter("/*")
public class SmartCorsFilter implements Filter {
    
    // å…è®¸çš„æºåˆ—è¡¨ï¼ˆç”Ÿäº§ç¯å¢ƒåº”è¯¥ä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰
    private static final Set<String> ALLOWED_ORIGINS = Set.of(
        "http://localhost:3000",    // æœ¬åœ°å¼€å‘ç¯å¢ƒ
        "http://localhost:8080",    // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ
        "https://myapp.com",        // ç”Ÿäº§ç¯å¢ƒå‰ç«¯
        "https://admin.myapp.com"   // ç®¡ç†åå°
    );
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // ğŸ”¸ è·å–è¯·æ±‚æ¥æº
        String origin = req.getHeader("Origin");
        
        // ğŸ”¸ æ£€æŸ¥æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­
        if (origin != null && ALLOWED_ORIGINS.contains(origin)) {
            resp.setHeader("Access-Control-Allow-Origin", origin);
            resp.setHeader("Access-Control-Allow-Credentials", "true");
        }
        
        // ğŸ”¸ è®¾ç½®å…¶ä»–CORSå¤´éƒ¨
        resp.setHeader("Access-Control-Allow-Methods", 
                      "GET, POST, PUT, DELETE, OPTIONS");
        resp.setHeader("Access-Control-Allow-Headers", 
                      "Content-Type, Authorization, X-Requested-With");
        resp.setHeader("Access-Control-Max-Age", "3600");
        
        chain.doFilter(request, response);
    }
}
```

---

## 4. ğŸš€ é¢„æ£€è¯·æ±‚å¤„ç†è¯¦è§£


### 4.1 ä»€ä¹ˆæ˜¯é¢„æ£€è¯·æ±‚


**é¢„æ£€è¯·æ±‚ï¼ˆPreflight Requestï¼‰**ï¼šå°±åƒå¿«é€’å‘˜é€åŒ…è£¹å‰å…ˆæ‰“ç”µè¯ç¡®è®¤ä½ åœ¨ä¸åœ¨å®¶ä¸€æ ·

```
ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘é¢„æ£€è¯·æ±‚ï¼Ÿ
âœ… ä½¿ç”¨äº†PUTã€DELETEã€PATCHç­‰"å¤æ‚"æ–¹æ³•
âœ… å‘é€äº†è‡ªå®šä¹‰å¤´éƒ¨ï¼ˆå¦‚Authorizationï¼‰
âœ… Content-Typeæ˜¯application/jsonç­‰ç‰¹æ®Šç±»å‹

é¢„æ£€è¯·æ±‚æµç¨‹ï¼š
ç¬¬1æ­¥ï¼šæµè§ˆå™¨å…ˆå‘é€OPTIONSè¯·æ±‚ï¼ˆé¢„æ£€ï¼‰
ç¬¬2æ­¥ï¼šæœåŠ¡å™¨å›å¤"æˆ‘å…è®¸è¿™ç§è¯·æ±‚"
ç¬¬3æ­¥ï¼šæµè§ˆå™¨å†å‘é€çœŸæ­£çš„ä¸šåŠ¡è¯·æ±‚
```

### 4.2 é¢„æ£€è¯·æ±‚ç¤ºä¾‹


**å‰ç«¯å‘èµ·çš„å¤æ‚è¯·æ±‚**ï¼š
```javascript
// è¿™ä¸ªè¯·æ±‚ä¼šè§¦å‘é¢„æ£€
fetch('http://localhost:8080/api/users', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer token123'
    },
    body: JSON.stringify({ name: 'Alice' })
});
```

**æµè§ˆå™¨è‡ªåŠ¨å‘é€çš„é¢„æ£€è¯·æ±‚**ï¼š
```
OPTIONS /api/users HTTP/1.1
Host: localhost:8080
Origin: http://localhost:3000
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type, Authorization
```

### 4.3 é¢„æ£€è¯·æ±‚å¤„ç†è¿‡æ»¤å™¨


```java
@WebFilter("/*")
public class PreflightCorsFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // ğŸ”¸ è®¾ç½®åŸºæœ¬CORSå¤´éƒ¨
        String origin = req.getHeader("Origin");
        if (origin != null && isAllowedOrigin(origin)) {
            resp.setHeader("Access-Control-Allow-Origin", origin);
            resp.setHeader("Access-Control-Allow-Credentials", "true");
        }
        
        // ğŸ”¸ ä¸“é—¨å¤„ç†OPTIONSé¢„æ£€è¯·æ±‚
        if ("OPTIONS".equals(req.getMethod())) {
            handlePreflightRequest(req, resp);
            return; // âš ï¸ é‡è¦ï¼šé¢„æ£€è¯·æ±‚å¤„ç†å®Œå°±è¿”å›ï¼Œä¸ç»§ç»­æ‰§è¡Œ
        }
        
        // ğŸ”¸ å¤„ç†å®é™…çš„ä¸šåŠ¡è¯·æ±‚
        resp.setHeader("Access-Control-Allow-Methods", 
                      "GET, POST, PUT, DELETE, OPTIONS");
        resp.setHeader("Access-Control-Allow-Headers", 
                      "Content-Type, Authorization, X-Requested-With");
        
        chain.doFilter(request, response);
    }
    
    private void handlePreflightRequest(HttpServletRequest req, HttpServletResponse resp) {
        // æ£€æŸ¥è¯·æ±‚çš„æ–¹æ³•æ˜¯å¦å…è®¸
        String requestMethod = req.getHeader("Access-Control-Request-Method");
        if (requestMethod != null) {
            resp.setHeader("Access-Control-Allow-Methods", 
                          "GET, POST, PUT, DELETE, OPTIONS");
        }
        
        // æ£€æŸ¥è¯·æ±‚çš„å¤´éƒ¨æ˜¯å¦å…è®¸
        String requestHeaders = req.getHeader("Access-Control-Request-Headers");
        if (requestHeaders != null) {
            resp.setHeader("Access-Control-Allow-Headers", requestHeaders);
        }
        
        // è®¾ç½®é¢„æ£€ç»“æœçš„ç¼“å­˜æ—¶é—´
        resp.setHeader("Access-Control-Max-Age", "3600");
        
        // è¿”å›200çŠ¶æ€ç 
        resp.setStatus(HttpServletResponse.SC_OK);
    }
    
    private boolean isAllowedOrigin(String origin) {
        return "http://localhost:3000".equals(origin) || 
               "http://localhost:8080".equals(origin);
    }
}
```

---

## 5. ğŸ›¡ï¸ å®‰å…¨ç­–ç•¥ä¸æœ€ä½³å®è·µ


### 5.1 ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®


> ğŸš¨ **å®‰å…¨è­¦å‘Š**ï¼šå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„CORSé…ç½®åº”è¯¥å®Œå…¨ä¸åŒï¼

```java
@WebFilter("/*")
public class ProductionCorsFilter implements Filter {
    
    @Override
    public void init(FilterConfig config) throws ServletException {
        // ä»é…ç½®æ–‡ä»¶è¯»å–å…è®¸çš„åŸŸå
        this.allowedOrigins = loadAllowedOriginsFromConfig();
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        String origin = req.getHeader("Origin");
        
        // ğŸ”¸ ä¸¥æ ¼æ£€æŸ¥æ¥æº
        if (origin != null && isSecureOrigin(origin)) {
            resp.setHeader("Access-Control-Allow-Origin", origin);
            
            // âš ï¸ åªæœ‰å—ä¿¡ä»»çš„æºæ‰å…è®¸æºå¸¦å‡­è¯
            if (isTrustedOrigin(origin)) {
                resp.setHeader("Access-Control-Allow-Credentials", "true");
            }
        }
        
        // ğŸ”¸ é™åˆ¶å…è®¸çš„æ–¹æ³•
        resp.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
        
        // ğŸ”¸ é™åˆ¶å…è®¸çš„å¤´éƒ¨
        resp.setHeader("Access-Control-Allow-Headers", 
                      "Content-Type, Authorization");
        
        // ğŸ”¸ è®¾ç½®è¾ƒçŸ­çš„é¢„æ£€ç¼“å­˜æ—¶é—´
        resp.setHeader("Access-Control-Max-Age", "1800"); // 30åˆ†é’Ÿ
        
        chain.doFilter(request, response);
    }
    
    private boolean isSecureOrigin(String origin) {
        // åªå…è®¸HTTPSåè®®çš„æºï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
        return origin.startsWith("https://") && allowedOrigins.contains(origin);
    }
    
    private boolean isTrustedOrigin(String origin) {
        // åªæœ‰å®Œå…¨ä¿¡ä»»çš„åŸŸåæ‰å…è®¸æºå¸¦å‡­è¯
        return Arrays.asList("https://myapp.com", "https://admin.myapp.com")
                    .contains(origin);
    }
}
```

### 5.2 é…ç½®æ–‡ä»¶ç®¡ç†


**web.xmlé…ç½®æ–¹å¼**ï¼š
```xml
<filter>
    <filter-name>CorsFilter</filter-name>
    <filter-class>com.example.filter.CorsFilter</filter-class>
    <init-param>
        <param-name>allowedOrigins</param-name>
        <param-value>http://localhost:3000,https://myapp.com</param-value>
    </init-param>
    <init-param>
        <param-name>allowCredentials</param-name>
        <param-value>true</param-value>
    </init-param>
</filter>
<filter-mapping>
    <filter-name>CorsFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

---

## 6. ğŸŒŸ å‰åç«¯åˆ†ç¦»é¡¹ç›®åº”ç”¨


### 6.1 å…¸å‹å‰åç«¯åˆ†ç¦»æ¶æ„


```
å‰ç«¯é¡¹ç›®ç»“æ„ï¼š
http://localhost:3000         â† React/Vueå‰ç«¯åº”ç”¨
â”œâ”€â”€ /login                   â† ç™»å½•é¡µé¢
â”œâ”€â”€ /dashboard              â† ä»ªè¡¨æ¿
â””â”€â”€ /api/*                  â† è°ƒç”¨åç«¯API

åç«¯é¡¹ç›®ç»“æ„ï¼š
http://localhost:8080        â† Spring Bootåç«¯
â”œâ”€â”€ /api/auth/login         â† ç™»å½•API
â”œâ”€â”€ /api/users              â† ç”¨æˆ·ç®¡ç†API  
â””â”€â”€ /api/data               â† æ•°æ®API
```

### 6.2 å®Œæ•´çš„å‰åç«¯è·¨åŸŸé…ç½®


**åç«¯è·¨åŸŸè¿‡æ»¤å™¨**ï¼š
```java
@WebFilter(urlPatterns = "/api/*")
public class ApiCorsFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // ğŸ”¸ è·å–å‰ç«¯åœ°å€
        String origin = req.getHeader("Origin");
        
        // ğŸ”¸ å…è®¸æœ¬åœ°å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
        if (isAllowedOrigin(origin)) {
            resp.setHeader("Access-Control-Allow-Origin", origin);
            resp.setHeader("Access-Control-Allow-Credentials", "true");
            resp.setHeader("Access-Control-Allow-Methods", 
                          "GET, POST, PUT, DELETE, OPTIONS");
            resp.setHeader("Access-Control-Allow-Headers", 
                          "Content-Type, Authorization, X-Requested-With");
            resp.setHeader("Access-Control-Max-Age", "3600");
        }
        
        // ğŸ”¸ å¤„ç†é¢„æ£€è¯·æ±‚
        if ("OPTIONS".equals(req.getMethod())) {
            resp.setStatus(HttpServletResponse.SC_OK);
            return;
        }
        
        chain.doFilter(request, response);
    }
    
    private boolean isAllowedOrigin(String origin) {
        return origin != null && (
            origin.equals("http://localhost:3000") ||  // æœ¬åœ°å¼€å‘
            origin.equals("http://localhost:3001") ||  // æœ¬åœ°æµ‹è¯•
            origin.equals("https://myapp.com")         // ç”Ÿäº§ç¯å¢ƒ
        );
    }
}
```

**å‰ç«¯è¯·æ±‚é…ç½®**ï¼š
```javascript
// axiosé…ç½®ç¤ºä¾‹
import axios from 'axios';

const api = axios.create({
    baseURL: 'http://localhost:8080/api',
    withCredentials: true,  // ğŸ”¸ å…è®¸æºå¸¦Cookie
    timeout: 5000,
    headers: {
        'Content-Type': 'application/json'
    }
});

// ä½¿ç”¨ç¤ºä¾‹
api.post('/users', { name: 'Alice' })
   .then(response => console.log(response.data))
   .catch(error => console.error('è¯·æ±‚å¤±è´¥:', error));
```

---

## 7. â“ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


### 7.1 å¸¸è§è·¨åŸŸé”™è¯¯


**âŒ é”™è¯¯ä¿¡æ¯1**ï¼š
```
Access to fetch at 'http://localhost:8080/api/data' from origin 
'http://localhost:3000' has been blocked by CORS policy: 
No 'Access-Control-Allow-Origin' header is present on the requested resource.
```
**âœ… è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨åç«¯æ·»åŠ  `Access-Control-Allow-Origin` å¤´éƒ¨

**âŒ é”™è¯¯ä¿¡æ¯2**ï¼š
```
Access to fetch at 'http://localhost:8080/api/data' from origin 
'http://localhost:3000' has been blocked by CORS policy: 
The value of the 'Access-Control-Allow-Origin' header in the response 
must not be the wildcard '*' when the request's credentials mode is 'include'.
```
**âœ… è§£å†³æ–¹æ¡ˆ**ï¼šä¸èƒ½åŒæ—¶è®¾ç½® `Access-Control-Allow-Origin: *` å’Œ `Access-Control-Allow-Credentials: true`

### 7.2 è°ƒè¯•æŠ€å·§


**ğŸ” æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥**ï¼š
```
1. æ‰“å¼€æµè§ˆå™¨F12å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
3. å‘é€è·¨åŸŸè¯·æ±‚
4. æŸ¥çœ‹è¯·æ±‚å¤´å’Œå“åº”å¤´ï¼š
   âœ… è¯·æ±‚å¤´åº”è¯¥åŒ…å«ï¼šOrigin
   âœ… å“åº”å¤´åº”è¯¥åŒ…å«ï¼šAccess-Control-Allow-Origin
   âœ… å¦‚æœæ˜¯å¤æ‚è¯·æ±‚ï¼Œè¿˜ä¼šçœ‹åˆ°OPTIONSé¢„æ£€è¯·æ±‚
```

**ğŸ“ å¸¸ç”¨è°ƒè¯•æ—¥å¿—**ï¼š
```java
@Override
public void doFilter(ServletRequest request, ServletResponse response, 
                    FilterChain chain) throws IOException, ServletException {
    
    HttpServletRequest req = (HttpServletRequest) request;
    String origin = req.getHeader("Origin");
    String method = req.getMethod();
    
    // ğŸ”¸ è°ƒè¯•æ—¥å¿—
    System.out.println("ğŸ” è·¨åŸŸè¯·æ±‚è°ƒè¯•:");
    System.out.println("   è¯·æ±‚æ–¹æ³•: " + method);
    System.out.println("   è¯·æ±‚æ¥æº: " + origin);
    System.out.println("   è¯·æ±‚è·¯å¾„: " + req.getRequestURI());
    
    // ... å…¶ä»–å¤„ç†é€»è¾‘
}
```

### 7.3 é—®é¢˜æ’æŸ¥æ¸…å•


**ğŸ“‹ è·¨åŸŸé—®é¢˜æ’æŸ¥æ­¥éª¤**ï¼š

âœ… **æ­¥éª¤1**ï¼šç¡®è®¤æ˜¯å¦çœŸçš„æ˜¯è·¨åŸŸé—®é¢˜
- æ£€æŸ¥å‰ç«¯åœ°å€å’Œåç«¯åœ°å€æ˜¯å¦ä¸åŒæº
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰CORSç›¸å…³é”™è¯¯

âœ… **æ­¥éª¤2**ï¼šæ£€æŸ¥åç«¯CORSé…ç½®
- ç¡®è®¤è¿‡æ»¤å™¨æ˜¯å¦æ­£ç¡®é…ç½®
- éªŒè¯ `Access-Control-Allow-Origin` è®¾ç½®æ˜¯å¦æ­£ç¡®

âœ… **æ­¥éª¤3**ï¼šæ£€æŸ¥é¢„æ£€è¯·æ±‚å¤„ç†
- å¤æ‚è¯·æ±‚æ˜¯å¦æ­£ç¡®å¤„ç†OPTIONSæ–¹æ³•
- é¢„æ£€å“åº”æ˜¯å¦åŒ…å«å¿…è¦çš„CORSå¤´éƒ¨

âœ… **æ­¥éª¤4**ï¼šæ£€æŸ¥å‡­è¯è®¾ç½®
- å¦‚æœéœ€è¦æºå¸¦Cookieï¼Œç¡®è®¤å‰åç«¯éƒ½æ­£ç¡®é…ç½®
- æ³¨æ„ä¸èƒ½åŒæ—¶ä½¿ç”¨é€šé…ç¬¦`*`å’Œ`credentials: true`

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è·¨åŸŸæœ¬è´¨ï¼šæµè§ˆå™¨çš„åŒæºç­–ç•¥é™åˆ¶ä¸åŒæºä¹‹é—´çš„èµ„æºè®¿é—®
ğŸ”¸ CORSåŸç†ï¼šæœåŠ¡å™¨é€šè¿‡å“åº”å¤´å‘Šè¯‰æµè§ˆå™¨å…è®¸è·¨åŸŸè®¿é—®
ğŸ”¸ é¢„æ£€è¯·æ±‚ï¼šå¤æ‚è¯·æ±‚å‰æµè§ˆå™¨ä¼šå…ˆå‘é€OPTIONSè¯·æ±‚ç¡®è®¤æƒé™
ğŸ”¸ å®‰å…¨ç­–ç•¥ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¸¥æ ¼é™åˆ¶å…è®¸çš„æºå’Œæƒé™
```

### 8.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ åŸºç¡€é…ç½®å¿…å¤‡é¡¹**ï¼š
```
Access-Control-Allow-Origin    â† å…è®¸çš„æºï¼ˆæœ€é‡è¦ï¼‰
Access-Control-Allow-Methods   â† å…è®¸çš„HTTPæ–¹æ³•
Access-Control-Allow-Headers   â† å…è®¸çš„è¯·æ±‚å¤´éƒ¨
Access-Control-Max-Age         â† é¢„æ£€ç¼“å­˜æ—¶é—´
```

**ğŸ”¹ å®‰å…¨é…ç½®åŸåˆ™**ï¼š
```
å¼€å‘ç¯å¢ƒï¼šå¯ä»¥ç›¸å¯¹å®½æ¾ï¼Œä¾¿äºå¼€å‘è°ƒè¯•
æµ‹è¯•ç¯å¢ƒï¼šæ¥è¿‘ç”Ÿäº§ç¯å¢ƒé…ç½®
ç”Ÿäº§ç¯å¢ƒï¼šä¸¥æ ¼é™åˆ¶ï¼Œåªå…è®¸å¿…è¦çš„æºå’Œæƒé™
```

**ğŸ”¹ å¸¸è§é…ç½®é™·é˜±**ï¼š
```
âŒ é”™è¯¯ï¼šAccess-Control-Allow-Origin: * + Allow-Credentials: true
âœ… æ­£ç¡®ï¼šæŒ‡å®šå…·ä½“åŸŸå + Allow-Credentials: true

âŒ é”™è¯¯ï¼šå¿˜è®°å¤„ç†OPTIONSé¢„æ£€è¯·æ±‚
âœ… æ­£ç¡®ï¼šä¸“é—¨å¤„ç†OPTIONSè¯·æ±‚å¹¶æå‰è¿”å›

âŒ é”™è¯¯ï¼šè¿‡æ»¤å™¨ä¼˜å…ˆçº§ä¸å½“å¯¼è‡´CORSå¤´éƒ¨è¢«è¦†ç›–
âœ… æ­£ç¡®ï¼šç¡®ä¿CORSè¿‡æ»¤å™¨åœ¨å…¶ä»–è¿‡æ»¤å™¨ä¹‹å‰æ‰§è¡Œ
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ’¡ å¼€å‘é˜¶æ®µå»ºè®®**ï¼š
- ä½¿ç”¨è¾ƒå®½æ¾çš„CORSé…ç½®ï¼Œä¾¿äºå‰åç«¯è”è°ƒ
- æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
- å¯ä»¥ä¸´æ—¶ä½¿ç”¨é€šé…ç¬¦`*`ï¼Œä½†è®°ä½ç”Ÿäº§ç¯å¢ƒå¿…é¡»æ”¹æ‰

**ğŸ’¡ ç”Ÿäº§é˜¶æ®µå»ºè®®**ï¼š
- ä¸¥æ ¼é™åˆ¶å…è®¸çš„æºï¼Œåªæ·»åŠ çœŸæ­£éœ€è¦çš„åŸŸå
- å®šæœŸå®¡æŸ¥å’Œæ›´æ–°å…è®¸çš„æºåˆ—è¡¨
- ç›‘æ§è·¨åŸŸè®¿é—®æ—¥å¿—ï¼Œå‘ç°å¼‚å¸¸è®¿é—®åŠæ—¶å¤„ç†

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è·¨åŸŸé—®é¢˜åˆ«æ…Œå¼ ï¼ŒCORSè¿‡æ»¤æ¥å¸®å¿™
æºå¤´æ§åˆ¶æœ€é‡è¦ï¼Œé¢„æ£€å¤„ç†ä¸èƒ½å¿˜  
å¼€å‘å®½æ¾ç”Ÿäº§ä¸¥ï¼Œå®‰å…¨ç¬¬ä¸€è®°å¿ƒä¸Š
```