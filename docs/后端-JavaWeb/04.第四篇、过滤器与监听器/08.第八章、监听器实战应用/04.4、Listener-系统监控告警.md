---
title: 4ã€Listener-ç³»ç»Ÿç›‘æ§å‘Šè­¦
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿç›‘æ§åŸºç¡€æ¦‚å¿µ](#1-ç³»ç»Ÿç›‘æ§åŸºç¡€æ¦‚å¿µ)
2. [ç³»ç»Ÿèµ„æºç›‘æ§](#2-ç³»ç»Ÿèµ„æºç›‘æ§)
3. [å¼‚å¸¸æƒ…å†µå‘Šè­¦](#3-å¼‚å¸¸æƒ…å†µå‘Šè­¦)
4. [æ€§èƒ½æŒ‡æ ‡æ”¶é›†](#4-æ€§èƒ½æŒ‡æ ‡æ”¶é›†)
5. [å¥åº·çŠ¶æ€æ£€æŸ¥](#5-å¥åº·çŠ¶æ€æ£€æŸ¥)
6. [è‡ªåŠ¨æ•…éšœæ¢å¤](#6-è‡ªåŠ¨æ•…éšœæ¢å¤)
7. [ç›‘æ§æ•°æ®å¯è§†åŒ–](#7-ç›‘æ§æ•°æ®å¯è§†åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç³»ç»Ÿç›‘æ§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿç›‘æ§


**é€šä¿—ç†è§£**ï¼šç³»ç»Ÿç›‘æ§å°±åƒç»™ä½ çš„Webåº”ç”¨å®‰è£…äº†ä¸€ä¸ª"å¥åº·ç®¡å®¶"

```
æƒ³è±¡ä¸€ä¸‹ï¼š
ä½ çš„ç½‘ç«™ = ä¸€ä¸ªå¿™ç¢Œçš„å•†åº—
ç›‘å¬å™¨ = åº—é•¿çš„çœ¼ç›å’Œè€³æœµ
éšæ—¶è§‚å¯Ÿï¼šå®¢äººå¤šä¸å¤šï¼Ÿè´§æ¶å¤Ÿä¸å¤Ÿï¼Ÿå‘˜å·¥å¿™ä¸å¿™ï¼Ÿ
å‘ç°é—®é¢˜ï¼šç«‹å³é€šçŸ¥ï¼Œå¿«é€Ÿè§£å†³
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ“Š **å®æ—¶ç›‘æµ‹**ï¼šæ—¶åˆ»å…³æ³¨ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
- ğŸš¨ **åŠæ—¶å‘Šè­¦**ï¼šå‘ç°å¼‚å¸¸ç«‹å³é€šçŸ¥
- ğŸ“ˆ **æ•°æ®æ”¶é›†**ï¼šè®°å½•ç³»ç»Ÿè¿è¡Œæ•°æ®
- ğŸ”§ **è‡ªåŠ¨å¤„ç†**ï¼šç®€å•é—®é¢˜è‡ªåŠ¨ä¿®å¤

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç³»ç»Ÿç›‘æ§


ğŸ’¡ **å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š
- ç½‘ç«™çªç„¶å˜æ…¢äº†ï¼Œç”¨æˆ·æŠ±æ€¨ï¼Œä½†ä½ ä¸çŸ¥é“åŸå› 
- æœåŠ¡å™¨å†…å­˜ä¸å¤Ÿäº†ï¼Œä½†ä½ è¿˜åœ¨ç¡è§‰
- æ•°æ®åº“è¿æ¥æ± æ»¡äº†ï¼Œæ–°ç”¨æˆ·æ— æ³•ç™»å½•
- æŸä¸ªåŠŸèƒ½å‡ºé”™äº†ï¼Œä½†æ²¡æœ‰äººå‘ç°

**ç›‘æ§çš„ä»·å€¼**ï¼š
```
æ²¡æœ‰ç›‘æ§ï¼šé—®é¢˜å‘ç”Ÿ â†’ ç”¨æˆ·æŠ•è¯‰ â†’ æ‰çŸ¥é“å‡ºé—®é¢˜
æœ‰äº†ç›‘æ§ï¼šé—®é¢˜è‹—å¤´ â†’ ç³»ç»Ÿå‘Šè­¦ â†’ æå‰è§£å†³
```

### 1.3 ç›‘å¬å™¨åœ¨ç›‘æ§ä¸­çš„ä½œç”¨


ğŸ”— **ç›‘å¬å™¨çš„å¤©ç„¶ä¼˜åŠ¿**ï¼š
- **äº‹ä»¶é©±åŠ¨**ï¼šç³»ç»Ÿä¸€æœ‰å˜åŒ–å°±èƒ½çŸ¥é“
- **å…¨å±€è¦†ç›–**ï¼šå¯ä»¥ç›‘å¬æ•´ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
- **è½»é‡çº§**ï¼šä¸ä¼šå¯¹ç³»ç»Ÿé€ æˆå¤ªå¤§è´Ÿæ‹…
- **é›†æˆç®€å•**ï¼šJavaWebåŸç”Ÿæ”¯æŒ

ğŸ“ **ç›‘æ§å±‚æ¬¡åˆ’åˆ†**ï¼š
| ç›‘æ§å±‚æ¬¡ | å…³æ³¨ç‚¹ | ç›‘å¬å™¨ç±»å‹ |
|----------|--------|------------|
| ğŸŒ **åº”ç”¨å±‚** | ç”¨æˆ·è®¿é—®ã€ä¼šè¯çŠ¶æ€ | `HttpSessionListener` |
| ğŸ”§ **ä¸šåŠ¡å±‚** | ä¸šåŠ¡é€»è¾‘æ‰§è¡Œæƒ…å†µ | `ServletRequestListener` |
| ğŸ’¾ **ç³»ç»Ÿå±‚** | å†…å­˜ã€CPUã€è¿æ¥æ±  | `ServletContextListener` |

---

## 2. ğŸ“Š ç³»ç»Ÿèµ„æºç›‘æ§


### 2.1 å†…å­˜ä½¿ç”¨ç›‘æ§


**åŸºæœ¬æ¦‚å¿µ**ï¼šç›‘æ§JVMå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œé˜²æ­¢å†…å­˜æº¢å‡º

ğŸ§  **é€šä¿—ç†è§£**ï¼šå°±åƒç›‘æ§æ‰‹æœºå†…å­˜ï¼Œæ»¡äº†å°±æ¸…ç†æˆ–æé†’

```java
@WebListener
public class MemoryMonitorListener implements ServletContextListener {
    private ScheduledExecutorService scheduler;
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        // å¯åŠ¨å†…å­˜ç›‘æ§ä»»åŠ¡
        scheduler = Executors.newSingleThreadScheduledExecutor();
        
        // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡å†…å­˜
        scheduler.scheduleAtFixedRate(() -> {
            checkMemoryUsage(sce.getServletContext());
        }, 0, 30, TimeUnit.SECONDS);
    }
    
    private void checkMemoryUsage(ServletContext context) {
        // è·å–å†…å­˜ä¿¡æ¯
        Runtime runtime = Runtime.getRuntime();
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        long usedMemory = totalMemory - freeMemory;
        
        // è®¡ç®—ä½¿ç”¨ç‡
        double usageRate = (double) usedMemory / totalMemory * 100;
        
        // å­˜å‚¨åˆ°åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¾›é¡µé¢å±•ç¤º
        context.setAttribute("memoryUsage", Math.round(usageRate));
        
        // è¶…è¿‡80%å°±å‘Šè­¦
        if (usageRate > 80) {
            sendAlert("å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: " + Math.round(usageRate) + "%");
        }
    }
}
```

ğŸ’¡ **å…³é”®ç†è§£**ï¼š
- `Runtime.getRuntime()`ï¼šè·å–å½“å‰JVMè¿è¡Œæ—¶ä¿¡æ¯
- `totalMemory()`ï¼šJVMæ€»å…±åˆ†é…çš„å†…å­˜
- `freeMemory()`ï¼šJVMå½“å‰ç©ºé—²å†…å­˜
- ä½¿ç”¨ç‡ = (æ€»å†…å­˜ - ç©ºé—²å†…å­˜) / æ€»å†…å­˜

### 2.2 æ•°æ®åº“è¿æ¥æ± ç›‘æ§


**å®é™…é—®é¢˜**ï¼šè¿æ¥æ± æ»¡äº†ï¼Œæ–°ç”¨æˆ·æ— æ³•è®¿é—®æ•°æ®åº“

ğŸŠâ€â™€ï¸ **å½¢è±¡æ¯”å–»**ï¼šè¿æ¥æ± å°±åƒæ¸¸æ³³æ± çš„æ›´è¡£æŸœï¼ŒæŸœå­æ»¡äº†æ–°å®¢äººå°±æ— æ³•æ¸¸æ³³

```java
@WebListener
public class ConnectionPoolMonitor implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        // å®šæ—¶æ£€æŸ¥è¿æ¥æ± çŠ¶æ€
        Timer timer = new Timer("ConnectionPoolMonitor", true);
        timer.scheduleAtFixedRate(new TimerTask() {
            @Override
            public void run() {
                monitorConnectionPool(sce.getServletContext());
            }
        }, 0, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    }
    
    private void monitorConnectionPool(ServletContext context) {
        try {
            // è·å–æ•°æ®æºï¼ˆè¿™é‡Œå‡è®¾ä½¿ç”¨HikariCPè¿æ¥æ± ï¼‰
            DataSource dataSource = getDataSource();
            
            if (dataSource instanceof HikariDataSource) {
                HikariDataSource hikariDS = (HikariDataSource) dataSource;
                HikariPoolMXBean poolBean = hikariDS.getHikariPoolMXBean();
                
                int activeConnections = poolBean.getActiveConnections();
                int totalConnections = poolBean.getTotalConnections();
                int idleConnections = poolBean.getIdleConnections();
                
                // è®¡ç®—ä½¿ç”¨ç‡
                double usageRate = (double) activeConnections / totalConnections * 100;
                
                // è®°å½•ç›‘æ§æ•°æ®
                context.setAttribute("dbActiveConnections", activeConnections);
                context.setAttribute("dbTotalConnections", totalConnections);
                context.setAttribute("dbUsageRate", Math.round(usageRate));
                
                // è¿æ¥ä½¿ç”¨ç‡è¶…è¿‡90%å‘Šè­¦
                if (usageRate > 90) {
                    sendAlert(String.format(
                        "æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡è¿‡é«˜: %d%%ï¼Œæ´»è·ƒè¿æ¥: %d/%d", 
                        Math.round(usageRate), activeConnections, totalConnections
                    ));
                }
            }
        } catch (Exception e) {
            sendAlert("è·å–è¿æ¥æ± ä¿¡æ¯å¤±è´¥: " + e.getMessage());
        }
    }
}
```

ğŸ”‘ **æ ¸å¿ƒè¦ç‚¹**ï¼š
- **æ´»è·ƒè¿æ¥**ï¼šæ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“è¿æ¥
- **æ€»è¿æ¥æ•°**ï¼šè¿æ¥æ± é…ç½®çš„æœ€å¤§è¿æ¥æ•°
- **ä½¿ç”¨ç‡**ï¼šå½“å‰æœ‰å¤šå°‘æ¯”ä¾‹çš„è¿æ¥åœ¨ä½¿ç”¨
- **å‘Šè­¦é˜ˆå€¼**ï¼šé€šå¸¸è®¾ç½®åœ¨80%-90%

### 2.3 CPUä½¿ç”¨ç‡ç›‘æ§


**ä¸ºä»€ä¹ˆç›‘æ§CPU**ï¼šCPUè¿‡é«˜ä¼šå¯¼è‡´ç³»ç»Ÿå“åº”ç¼“æ…¢

âš¡ **ç®€å•ç†è§£**ï¼šCPUå°±åƒå¨å¸ˆï¼Œå¤ªå¿™äº†å°±åšèœæ…¢ï¼Œå®¢äººç­‰å¾—æ€¥

```java
@WebListener
public class CpuMonitorListener implements ServletContextListener {
    private ScheduledExecutorService cpuMonitor;
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        cpuMonitor = Executors.newSingleThreadScheduledExecutor();
        
        // æ¯2åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡CPUä½¿ç”¨ç‡
        cpuMonitor.scheduleAtFixedRate(() -> {
            monitorCpuUsage(sce.getServletContext());
        }, 0, 2, TimeUnit.MINUTES);
    }
    
    private void monitorCpuUsage(ServletContext context) {
        // è·å–æ“ä½œç³»ç»ŸMXBean
        OperatingSystemMXBean osBean = 
            (OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();
        
        // è·å–CPUä½¿ç”¨ç‡ï¼ˆ0.0-1.0ä¹‹é—´ï¼‰
        double cpuUsage = osBean.getProcessCpuLoad() * 100;
        
        if (cpuUsage >= 0) { // -1è¡¨ç¤ºè·å–å¤±è´¥
            context.setAttribute("cpuUsage", Math.round(cpuUsage));
            
            // CPUä½¿ç”¨ç‡è¶…è¿‡85%å‘Šè­¦
            if (cpuUsage > 85) {
                sendAlert("CPUä½¿ç”¨ç‡è¿‡é«˜: " + Math.round(cpuUsage) + "%");
            }
        }
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        if (cpuMonitor != null) {
            cpuMonitor.shutdown();
        }
    }
}
```

---

## 3. ğŸš¨ å¼‚å¸¸æƒ…å†µå‘Šè­¦


### 3.1 åº”ç”¨å¯åŠ¨å¤±è´¥ç›‘æ§


**åœºæ™¯**ï¼šåº”ç”¨å¯åŠ¨æ—¶å¦‚æœæŸäº›å…³é”®ç»„ä»¶åŠ è½½å¤±è´¥ï¼Œéœ€è¦ç«‹å³å‘ŠçŸ¥

ğŸš¦ **å®é™…ä»·å€¼**ï¼šå°±åƒæ±½è½¦å¯åŠ¨æ—¶ä»ªè¡¨ç›˜çš„æ•…éšœç¯ï¼Œæœ‰é—®é¢˜ç«‹å³æ˜¾ç¤º

```java
@WebListener
public class StartupMonitorListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext context = sce.getServletContext();
        List<String> startupErrors = new ArrayList<>();
        
        try {
            // æ£€æŸ¥æ•°æ®åº“è¿æ¥
            if (!checkDatabase()) {
                startupErrors.add("æ•°æ®åº“è¿æ¥å¤±è´¥");
            }
            
            // æ£€æŸ¥Redisè¿æ¥
            if (!checkRedis()) {
                startupErrors.add("Redisè¿æ¥å¤±è´¥");
            }
            
            // æ£€æŸ¥å¤–éƒ¨API
            if (!checkExternalApi()) {
                startupErrors.add("å¤–éƒ¨APIè¿æ¥å¤±è´¥");
            }
            
            // å¦‚æœæœ‰å¯åŠ¨é”™è¯¯ï¼Œè®°å½•å¹¶å‘Šè­¦
            if (!startupErrors.isEmpty()) {
                String errorMsg = "åº”ç”¨å¯åŠ¨æ£€æŸ¥å‘ç°é—®é¢˜: " + String.join(", ", startupErrors);
                context.setAttribute("startupErrors", startupErrors);
                sendAlert(errorMsg);
                
                // å¯ä»¥é€‰æ‹©æ˜¯å¦é˜»æ­¢åº”ç”¨å¯åŠ¨
                // throw new RuntimeException("å¯åŠ¨æ£€æŸ¥å¤±è´¥ï¼Œåœæ­¢åº”ç”¨å¯åŠ¨");
            } else {
                context.setAttribute("startupStatus", "æ­£å¸¸");
                System.out.println("âœ… åº”ç”¨å¯åŠ¨æ£€æŸ¥é€šè¿‡ï¼Œæ‰€æœ‰ç»„ä»¶æ­£å¸¸");
            }
            
        } catch (Exception e) {
            sendAlert("å¯åŠ¨æ£€æŸ¥è¿‡ç¨‹å‡ºç°å¼‚å¸¸: " + e.getMessage());
        }
    }
    
    private boolean checkDatabase() {
        // ç®€åŒ–çš„æ•°æ®åº“è¿æ¥æ£€æŸ¥
        try (Connection conn = getDataSource().getConnection()) {
            return conn != null && !conn.isClosed();
        } catch (Exception e) {
            return false;
        }
    }
    
    private boolean checkRedis() {
        // ç®€åŒ–çš„Redisè¿æ¥æ£€æŸ¥
        try {
            // å‡è®¾æœ‰Rediså®¢æˆ·ç«¯
            // return redisTemplate.getConnectionFactory().getConnection().ping();
            return true; // ç¤ºä¾‹è¿”å›
        } catch (Exception e) {
            return false;
        }
    }
    
    private boolean checkExternalApi() {
        // æ£€æŸ¥å…³é”®çš„å¤–éƒ¨APIæ˜¯å¦å¯ç”¨
        try {
            URL url = new URL("https://api.example.com/health");
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setRequestMethod("GET");
            conn.setConnectTimeout(5000);
            conn.setReadTimeout(5000);
            return conn.getResponseCode() == 200;
        } catch (Exception e) {
            return false;
        }
    }
}
```

### 3.2 ä¼šè¯å¼‚å¸¸ç›‘æ§


**ç›‘æ§ç›®æ ‡**ï¼šç›‘æ§ç”¨æˆ·ä¼šè¯çš„å¼‚å¸¸æƒ…å†µï¼Œå¦‚éæ­£å¸¸é€€å‡ºã€ä¼šè¯åŠ«æŒç­‰

ğŸ‘¥ **ç”Ÿæ´»åŒ–ç†è§£**ï¼šå°±åƒç›‘æ§å•†åœºçš„é¡¾å®¢è¡Œä¸ºï¼Œå‘ç°å¼‚å¸¸ç«‹å³å¤„ç†

```java
@WebListener
public class SessionAnomalyListener implements HttpSessionListener, 
                                             HttpSessionAttributeListener {
    
    // è®°å½•ä¼šè¯åˆ›å»ºæ—¶é—´å’ŒIP
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        
        // è®°å½•ä¼šè¯åŸºæœ¬ä¿¡æ¯
        session.setAttribute("createTime", System.currentTimeMillis());
        session.setAttribute("lastAccessTime", System.currentTimeMillis());
        
        // è·å–ç”¨æˆ·IPï¼ˆéœ€è¦åœ¨è¯·æ±‚ä¸­è®¾ç½®ï¼‰
        String clientIP = getClientIP(session);
        session.setAttribute("clientIP", clientIP);
        
        System.out.println("ğŸŸ¢ æ–°ä¼šè¯åˆ›å»º: " + session.getId() + ", IP: " + clientIP);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        
        Long createTime = (Long) session.getAttribute("createTime");
        Long lastAccessTime = (Long) session.getAttribute("lastAccessTime");
        String clientIP = (String) session.getAttribute("clientIP");
        
        if (createTime != null && lastAccessTime != null) {
            long sessionDuration = lastAccessTime - createTime;
            
            // ä¼šè¯æ—¶é•¿å¼‚å¸¸çŸ­ï¼ˆå¯èƒ½æ˜¯æ”»å‡»ï¼‰
            if (sessionDuration < 10000) { // å°‘äº10ç§’
                sendAlert(String.format(
                    "æ£€æµ‹åˆ°å¼‚å¸¸çŸ­ä¼šè¯ - ID: %s, IP: %s, æ—¶é•¿: %dç§’", 
                    session.getId(), clientIP, sessionDuration / 1000
                ));
            }
            
            // ä¼šè¯æ—¶é•¿å¼‚å¸¸é•¿ï¼ˆå¯èƒ½å¿˜è®°é€€å‡ºï¼‰
            if (sessionDuration > 24 * 60 * 60 * 1000) { // è¶…è¿‡24å°æ—¶
                System.out.println("âš ï¸ å‘ç°é•¿æ—¶é—´ä¼šè¯: " + session.getId() + 
                                 ", æ—¶é•¿: " + (sessionDuration / 1000 / 60 / 60) + "å°æ—¶");
            }
        }
        
        System.out.println("ğŸ”´ ä¼šè¯é”€æ¯: " + session.getId());
    }
    
    @Override
    public void attributeAdded(HttpSessionBindingEvent se) {
        // ç›‘æ§æ•æ„Ÿå±æ€§çš„æ·»åŠ 
        String attributeName = se.getName();
        if ("user".equals(attributeName) || "userInfo".equals(attributeName)) {
            System.out.println("ğŸ‘¤ ç”¨æˆ·ç™»å½•: " + se.getSession().getId());
        }
    }
    
    @Override
    public void attributeReplaced(HttpSessionBindingEvent se) {
        String attributeName = se.getName();
        
        // ç›‘æ§IPåœ°å€å˜åŒ–ï¼ˆå¯èƒ½çš„ä¼šè¯åŠ«æŒï¼‰
        if ("clientIP".equals(attributeName)) {
            String oldIP = (String) se.getValue();
            String newIP = (String) se.getSession().getAttribute("clientIP");
            
            if (!Objects.equals(oldIP, newIP)) {
                sendAlert(String.format(
                    "âš ï¸ æ£€æµ‹åˆ°ä¼šè¯IPå˜åŒ– - ä¼šè¯ID: %s, åŸIP: %s, æ–°IP: %s", 
                    se.getSession().getId(), oldIP, newIP
                ));
            }
        }
    }
    
    private String getClientIP(HttpSession session) {
        // è¿™é‡Œéœ€è¦åœ¨è¯·æ±‚å¤„ç†æ—¶è®¾ç½®IPä¿¡æ¯
        // å®é™…ä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡ThreadLocalæˆ–å…¶ä»–æ–¹å¼è·å–
        return "127.0.0.1"; // ç¤ºä¾‹IP
    }
}
```

---

## 4. ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡æ”¶é›†


### 4.1 è¯·æ±‚å“åº”æ—¶é—´ç»Ÿè®¡


**ç›®æ ‡**ï¼šæ”¶é›†æ¯ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

â±ï¸ **é€šä¿—è§£é‡Š**ï¼šå°±åƒè®°å½•æ¯é“èœçš„åˆ¶ä½œæ—¶é—´ï¼Œæ‰¾å‡ºå“ªé“èœåšå¾—å¤ªæ…¢

```java
@WebListener
public class PerformanceCollector implements ServletRequestListener {
    
    @Override
    public void requestInitialized(ServletRequestEvent sre) {
        // è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
        sre.getServletRequest().setAttribute("startTime", System.currentTimeMillis());
    }
    
    @Override
    public void requestDestroyed(ServletRequestEvent sre) {
        Long startTime = (Long) sre.getServletRequest().getAttribute("startTime");
        if (startTime != null) {
            long endTime = System.currentTimeMillis();
            long duration = endTime - startTime;
            
            HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();
            String uri = request.getRequestURI();
            String method = request.getMethod();
            
            // æ”¶é›†æ€§èƒ½æ•°æ®
            collectPerformanceData(uri, method, duration);
            
            // æ…¢è¯·æ±‚å‘Šè­¦ï¼ˆè¶…è¿‡5ç§’ï¼‰
            if (duration > 5000) {
                sendSlowRequestAlert(uri, method, duration);
            }
        }
    }
    
    private void collectPerformanceData(String uri, String method, long duration) {
        // è·å–åº”ç”¨ä¸Šä¸‹æ–‡æ¥å­˜å‚¨ç»Ÿè®¡æ•°æ®
        ServletContext context = getCurrentServletContext();
        
        // è·å–æˆ–åˆ›å»ºæ€§èƒ½ç»Ÿè®¡Map
        @SuppressWarnings("unchecked")
        Map<String, PerformanceStats> statsMap = 
            (Map<String, PerformanceStats>) context.getAttribute("performanceStats");
        
        if (statsMap == null) {
            statsMap = new ConcurrentHashMap<>();
            context.setAttribute("performanceStats", statsMap);
        }
        
        String key = method + " " + uri;
        PerformanceStats stats = statsMap.computeIfAbsent(key, k -> new PerformanceStats());
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        stats.addRequest(duration);
        
        System.out.printf("ğŸ“Š %s %s - è€—æ—¶: %dms, å¹³å‡: %.1fms, æ€»æ¬¡æ•°: %d%n", 
            method, uri, duration, stats.getAverageTime(), stats.getRequestCount());
    }
    
    private void sendSlowRequestAlert(String uri, String method, long duration) {
        String alertMsg = String.format(
            "ğŸŒ æ…¢è¯·æ±‚å‘Šè­¦ - %s %s è€—æ—¶: %dms", 
            method, uri, duration
        );
        sendAlert(alertMsg);
    }
    
    // æ€§èƒ½ç»Ÿè®¡æ•°æ®ç»“æ„
    public static class PerformanceStats {
        private long totalTime = 0;
        private long requestCount = 0;
        private long maxTime = 0;
        private long minTime = Long.MAX_VALUE;
        
        public synchronized void addRequest(long duration) {
            totalTime += duration;
            requestCount++;
            maxTime = Math.max(maxTime, duration);
            minTime = Math.min(minTime, duration);
        }
        
        public double getAverageTime() {
            return requestCount > 0 ? (double) totalTime / requestCount : 0;
        }
        
        // getteræ–¹æ³•
        public long getRequestCount() { return requestCount; }
        public long getMaxTime() { return maxTime; }
        public long getMinTime() { return minTime == Long.MAX_VALUE ? 0 : minTime; }
    }
}
```

### 4.2 å¹¶å‘ç”¨æˆ·æ•°ç»Ÿè®¡


**ä½œç”¨**ï¼šå®æ—¶ç»Ÿè®¡å½“å‰åœ¨çº¿ç”¨æˆ·æ•°å’Œç³»ç»Ÿè´Ÿè½½

ğŸ‘¥ **å½¢è±¡æ¯”å–»**ï¼šå°±åƒå•†åœºçš„å®¢æµç»Ÿè®¡å™¨ï¼ŒçŸ¥é“ç°åœ¨æœ‰å¤šå°‘é¡¾å®¢åœ¨è´­ç‰©

```java
@WebListener
public class ConcurrentUserCounter implements HttpSessionListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        ServletContext context = se.getSession().getServletContext();
        
        // å¢åŠ åœ¨çº¿ç”¨æˆ·æ•°
        Integer onlineUsers = (Integer) context.getAttribute("onlineUsers");
        if (onlineUsers == null) {
            onlineUsers = 0;
        }
        onlineUsers++;
        context.setAttribute("onlineUsers", onlineUsers);
        
        // è®°å½•å†å²æœ€é«˜å¹¶å‘æ•°
        Integer maxConcurrent = (Integer) context.getAttribute("maxConcurrentUsers");
        if (maxConcurrent == null || onlineUsers > maxConcurrent) {
            context.setAttribute("maxConcurrentUsers", onlineUsers);
        }
        
        System.out.println("ğŸ‘¤ å½“å‰åœ¨çº¿ç”¨æˆ·: " + onlineUsers);
        
        // å¹¶å‘ç”¨æˆ·è¿‡å¤šå‘Šè­¦
        if (onlineUsers > 1000) { // å‡è®¾é˜ˆå€¼æ˜¯1000
            sendAlert("å¹¶å‘ç”¨æˆ·æ•°è¿‡å¤š: " + onlineUsers + " äºº");
        }
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        ServletContext context = se.getSession().getServletContext();
        
        // å‡å°‘åœ¨çº¿ç”¨æˆ·æ•°
        Integer onlineUsers = (Integer) context.getAttribute("onlineUsers");
        if (onlineUsers != null && onlineUsers > 0) {
            onlineUsers--;
            context.setAttribute("onlineUsers", onlineUsers);
            System.out.println("ğŸ‘¤ å½“å‰åœ¨çº¿ç”¨æˆ·: " + onlineUsers);
        }
    }
}
```

---

## 5. ğŸ¥ å¥åº·çŠ¶æ€æ£€æŸ¥


### 5.1 åº”ç”¨å¥åº·æ£€æŸ¥ç«¯ç‚¹


**ç›®çš„**ï¼šæä¾›ä¸€ä¸ªç»Ÿä¸€çš„å¥åº·æ£€æŸ¥æ¥å£ï¼Œä¾›è¿ç»´ç³»ç»Ÿè°ƒç”¨

ğŸ©º **å®é™…ä½œç”¨**ï¼šå°±åƒä½“æ£€ä¸­å¿ƒçš„å¿«é€Ÿæ£€æµ‹ï¼Œä¸€æ¬¡æ£€æŸ¥å¤šä¸ªé¡¹ç›®

```java
@WebListener
public class HealthCheckListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext context = sce.getServletContext();
        
        // å®šæ—¶æ‰§è¡Œå¥åº·æ£€æŸ¥
        Timer healthCheckTimer = new Timer("HealthCheck", true);
        healthCheckTimer.scheduleAtFixedRate(new TimerTask() {
            @Override
            public void run() {
                performHealthCheck(context);
            }
        }, 0, 120000); // æ¯2åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        
        context.setAttribute("healthCheckTimer", healthCheckTimer);
    }
    
    private void performHealthCheck(ServletContext context) {
        HealthStatus health = new HealthStatus();
        
        // 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
        health.setDatabaseStatus(checkDatabaseHealth());
        
        // 2. æ£€æŸ¥å†…å­˜ä½¿ç”¨
        health.setMemoryStatus(checkMemoryHealth());
        
        // 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
        health.setDiskStatus(checkDiskHealth());
        
        // 4. æ£€æŸ¥å¤–éƒ¨ä¾èµ–
        health.setExternalServiceStatus(checkExternalServices());
        
        // è®¡ç®—æ•´ä½“å¥åº·çŠ¶æ€
        health.calculateOverallStatus();
        
        // å­˜å‚¨å¥åº·çŠ¶æ€
        context.setAttribute("healthStatus", health);
        
        // å¦‚æœä¸å¥åº·ï¼Œå‘é€å‘Šè­¦
        if (!health.isHealthy()) {
            sendAlert("ç³»ç»Ÿå¥åº·æ£€æŸ¥å¼‚å¸¸: " + health.getUnhealthyReasons());
        }
        
        System.out.println("ğŸ¥ å¥åº·æ£€æŸ¥å®Œæˆ - çŠ¶æ€: " + 
            (health.isHealthy() ? "å¥åº· âœ…" : "å¼‚å¸¸ âŒ"));
    }
    
    private String checkDatabaseHealth() {
        try (Connection conn = getDataSource().getConnection()) {
            if (conn != null && !conn.isClosed()) {
                // æ‰§è¡Œä¸€ä¸ªç®€å•æŸ¥è¯¢æµ‹è¯•
                try (Statement stmt = conn.createStatement()) {
                    stmt.execute("SELECT 1");
                }
                return "å¥åº·";
            }
        } catch (Exception e) {
            return "å¼‚å¸¸: " + e.getMessage();
        }
        return "å¼‚å¸¸: æ— æ³•è·å–è¿æ¥";
    }
    
    private String checkMemoryHealth() {
        Runtime runtime = Runtime.getRuntime();
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        double usageRate = (double)(totalMemory - freeMemory) / totalMemory * 100;
        
        if (usageRate < 80) {
            return "å¥åº· (" + Math.round(usageRate) + "%)";
        } else {
            return "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡ " + Math.round(usageRate) + "%";
        }
    }
    
    private String checkDiskHealth() {
        File root = new File("/");
        long totalSpace = root.getTotalSpace();
        long freeSpace = root.getFreeSpace();
        double usageRate = (double)(totalSpace - freeSpace) / totalSpace * 100;
        
        if (usageRate < 85) {
            return "å¥åº· (" + Math.round(usageRate) + "%)";
        } else {
            return "è­¦å‘Š: ç£ç›˜ä½¿ç”¨ç‡ " + Math.round(usageRate) + "%";
        }
    }
    
    private String checkExternalServices() {
        // æ£€æŸ¥å…³é”®å¤–éƒ¨æœåŠ¡
        List<String> unhealthyServices = new ArrayList<>();
        
        // ç¤ºä¾‹ï¼šæ£€æŸ¥Redis
        if (!pingService("Redis", "localhost", 6379)) {
            unhealthyServices.add("Redis");
        }
        
        // ç¤ºä¾‹ï¼šæ£€æŸ¥å¤–éƒ¨API
        if (!checkHttpService("å¤–éƒ¨API", "https://api.example.com/health")) {
            unhealthyServices.add("å¤–éƒ¨API");
        }
        
        if (unhealthyServices.isEmpty()) {
            return "å¥åº·";
        } else {
            return "å¼‚å¸¸: " + String.join(", ", unhealthyServices);
        }
    }
    
    // å¥åº·çŠ¶æ€æ•°æ®ç»“æ„
    public static class HealthStatus {
        private String databaseStatus;
        private String memoryStatus;
        private String diskStatus;
        private String externalServiceStatus;
        private boolean isHealthy;
        private String overallStatus;
        
        public void calculateOverallStatus() {
            boolean allHealthy = 
                databaseStatus.startsWith("å¥åº·") &&
                memoryStatus.startsWith("å¥åº·") &&
                diskStatus.startsWith("å¥åº·") &&
                externalServiceStatus.startsWith("å¥åº·");
                
            this.isHealthy = allHealthy;
            this.overallStatus = allHealthy ? "å¥åº·" : "å¼‚å¸¸";
        }
        
        public String getUnhealthyReasons() {
            List<String> reasons = new ArrayList<>();
            if (!databaseStatus.startsWith("å¥åº·")) reasons.add("æ•°æ®åº“: " + databaseStatus);
            if (!memoryStatus.startsWith("å¥åº·")) reasons.add("å†…å­˜: " + memoryStatus);
            if (!diskStatus.startsWith("å¥åº·")) reasons.add("ç£ç›˜: " + diskStatus);
            if (!externalServiceStatus.startsWith("å¥åº·")) reasons.add("å¤–éƒ¨æœåŠ¡: " + externalServiceStatus);
            return String.join("; ", reasons);
        }
        
        // getterå’Œsetteræ–¹æ³•çœç•¥...
    }
}
```

---

## 6. ğŸ”§ è‡ªåŠ¨æ•…éšœæ¢å¤


### 6.1 è¿æ¥æ± è‡ªåŠ¨é‡ç½®


**åœºæ™¯**ï¼šå½“æ•°æ®åº“è¿æ¥æ± å‡ºç°é—®é¢˜æ—¶ï¼Œè‡ªåŠ¨å°è¯•é‡ç½®

ğŸ”„ **å®é™…æ„ä¹‰**ï¼šå°±åƒè·¯ç”±å™¨å¡ä½äº†è‡ªåŠ¨é‡å¯ï¼Œæ¢å¤æ­£å¸¸å·¥ä½œ

```java
@WebListener
public class AutoRecoveryListener implements ServletContextListener {
    private ScheduledExecutorService recoveryService;
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        recoveryService = Executors.newSingleThreadScheduledExecutor();
        
        // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼Œçœ‹æ˜¯å¦éœ€è¦è‡ªåŠ¨æ¢å¤
        recoveryService.scheduleAtFixedRate(() -> {
            checkAndRecover(sce.getServletContext());
        }, 5, 5, TimeUnit.MINUTES);
    }
    
    private void checkAndRecover(ServletContext context) {
        try {
            // æ£€æŸ¥æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
            if (isConnectionPoolStuck()) {
                System.out.println("ğŸ”§ æ£€æµ‹åˆ°è¿æ¥æ± å¼‚å¸¸ï¼Œå°è¯•è‡ªåŠ¨æ¢å¤...");
                
                boolean recoverySuccess = resetConnectionPool();
                
                if (recoverySuccess) {
                    String successMsg = "âœ… è¿æ¥æ± è‡ªåŠ¨æ¢å¤æˆåŠŸ";
                    System.out.println(successMsg);
                    sendAlert(successMsg);
                } else {
                    String failMsg = "âŒ è¿æ¥æ± è‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥";
                    System.out.println(failMsg);
                    sendAlert(failMsg);
                }
            }
            
            // æ£€æŸ¥å†…å­˜æ˜¯å¦éœ€è¦GC
            if (isMemoryPressureHigh()) {
                System.out.println("ğŸ§¹ æ£€æµ‹åˆ°å†…å­˜å‹åŠ›è¿‡é«˜ï¼Œæ‰§è¡Œåƒåœ¾å›æ”¶...");
                System.gc(); // å»ºè®®JVMæ‰§è¡Œåƒåœ¾å›æ”¶
                sendAlert("ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œäº†åƒåœ¾å›æ”¶ä»¥é‡Šæ”¾å†…å­˜");
            }
            
        } catch (Exception e) {
            sendAlert("è‡ªåŠ¨æ¢å¤è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸: " + e.getMessage());
        }
    }
    
    private boolean isConnectionPoolStuck() {
        try {
            // å°è¯•è·å–è¿æ¥ï¼Œè®¾ç½®è¾ƒçŸ­è¶…æ—¶æ—¶é—´
            DataSource dataSource = getDataSource();
            try (Connection conn = dataSource.getConnection()) {
                conn.setNetworkTimeout(Executors.newSingleThreadExecutor(), 3000);
                
                // æ‰§è¡Œç®€å•æŸ¥è¯¢æµ‹è¯•
                try (Statement stmt = conn.createStatement()) {
                    stmt.setQueryTimeout(3);
                    stmt.execute("SELECT 1");
                }
                return false; // è¿æ¥æ­£å¸¸
            }
        } catch (SQLException e) {
            System.out.println("âš ï¸ è¿æ¥æ± æ£€æŸ¥å¼‚å¸¸: " + e.getMessage());
            return true; // å¯èƒ½è¿æ¥æ± æœ‰é—®é¢˜
        }
    }
    
    private boolean resetConnectionPool() {
        try {
            // è¿™é‡Œçš„å…·ä½“å®ç°å–å†³äºä½¿ç”¨çš„è¿æ¥æ± ç±»å‹
            DataSource dataSource = getDataSource();
            
            if (dataSource instanceof HikariDataSource) {
                HikariDataSource hikariDS = (HikariDataSource) dataSource;
                
                // å…³é—­ç°æœ‰è¿æ¥æ± 
                hikariDS.getHikariPoolMXBean().softEvictConnections();
                
                // ç­‰å¾…ä¸€æ®µæ—¶é—´è®©è¿æ¥æ± é‡æ–°åˆå§‹åŒ–
                Thread.sleep(2000);
                
                // æµ‹è¯•æ–°è¿æ¥
                try (Connection testConn = hikariDS.getConnection()) {
                    return testConn != null && !testConn.isClosed();
                }
            }
            
            return false;
        } catch (Exception e) {
            System.out.println("è¿æ¥æ± é‡ç½®å¤±è´¥: " + e.getMessage());
            return false;
        }
    }
    
    private boolean isMemoryPressureHigh() {
        Runtime runtime = Runtime.getRuntime();
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        double usageRate = (double)(totalMemory - freeMemory) / totalMemory * 100;
        
        // å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%å°±è®¤ä¸ºå‹åŠ›è¿‡é«˜
        return usageRate > 90;
    }
}
```

### 6.2 ä¼šè¯æ¸…ç†æœºåˆ¶


**ç›®çš„**ï¼šè‡ªåŠ¨æ¸…ç†å¼‚å¸¸ä¼šè¯å’Œè¿‡æœŸæ•°æ®ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

ğŸ§¹ **é€šä¿—ç†è§£**ï¼šå°±åƒå®šæœŸæ¸…ç†æˆ¿é—´ï¼ŒæŠŠä¸ç”¨çš„ä¸œè¥¿æ‰”æ‰

```java
@WebListener
public class SessionCleanupListener implements ServletContextListener, HttpSessionListener {
    private final Map<String, SessionInfo> sessionTracker = new ConcurrentHashMap<>();
    private ScheduledExecutorService cleanupService;
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        cleanupService = Executors.newSingleThreadScheduledExecutor();
        
        // æ¯10åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡å¼‚å¸¸ä¼šè¯
        cleanupService.scheduleAtFixedRate(() -> {
            cleanupAbnormalSessions(sce.getServletContext());
        }, 10, 10, TimeUnit.MINUTES);
    }
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        String sessionId = se.getSession().getId();
        SessionInfo info = new SessionInfo();
        info.createTime = System.currentTimeMillis();
        info.lastAccessTime = System.currentTimeMillis();
        
        sessionTracker.put(sessionId, info);
        System.out.println("ğŸ“ è®°å½•æ–°ä¼šè¯: " + sessionId);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        String sessionId = se.getSession().getId();
        sessionTracker.remove(sessionId);
        System.out.println("ğŸ—‘ï¸ æ¸…ç†ä¼šè¯è®°å½•: " + sessionId);
    }
    
    private void cleanupAbnormalSessions(ServletContext context) {
        long currentTime = System.currentTimeMillis();
        long maxIdleTime = 30 * 60 * 1000; // 30åˆ†é’Ÿæ— æ´»åŠ¨
        int cleanedCount = 0;
        
        Iterator<Map.Entry<String, SessionInfo>> iterator = sessionTracker.entrySet().iterator();
        
        while (iterator.hasNext()) {
            Map.Entry<String, SessionInfo> entry = iterator.next();
            String sessionId = entry.getKey();
            SessionInfo info = entry.getValue();
            
            // æ£€æŸ¥æ˜¯å¦é•¿æ—¶é—´æœªæ´»åŠ¨
            if (currentTime - info.lastAccessTime > maxIdleTime) {
                try {
                    // å°è¯•è·å–å¹¶é”€æ¯è¿‡æœŸä¼šè¯
                    // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦é€šè¿‡åº”ç”¨æœåŠ¡å™¨çš„APIæ¥æ“ä½œ
                    // å…·ä½“å®ç°å–å†³äºä½¿ç”¨çš„æœåŠ¡å™¨ç±»å‹
                    
                    iterator.remove();
                    cleanedCount++;
                    
                    System.out.println("ğŸ§¹ æ¸…ç†è¿‡æœŸä¼šè¯: " + sessionId + 
                        " (é—²ç½®æ—¶é—´: " + ((currentTime - info.lastAccessTime) / 1000 / 60) + "åˆ†é’Ÿ)");
                        
                } catch (Exception e) {
                    System.out.println("æ¸…ç†ä¼šè¯å¤±è´¥: " + sessionId + ", " + e.getMessage());
                }
            }
        }
        
        if (cleanedCount > 0) {
            String msg = "è‡ªåŠ¨æ¸…ç†äº† " + cleanedCount + " ä¸ªè¿‡æœŸä¼šè¯";
            System.out.println("âœ… " + msg);
            sendAlert(msg);
        }
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        if (cleanupService != null) {
            cleanupService.shutdown();
        }
    }
    
    // ä¼šè¯ä¿¡æ¯è®°å½•
    private static class SessionInfo {
        long createTime;
        long lastAccessTime;
        String userAgent;
        String clientIP;
    }
}
```

---

## 7. ğŸ“Š ç›‘æ§æ•°æ®å¯è§†åŒ–


### 7.1 å®æ—¶ç›‘æ§é¢æ¿


**ç›®çš„**ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„Webé¡µé¢ï¼Œå±•ç¤ºç³»ç»Ÿç›‘æ§æ•°æ®

ğŸ–¥ï¸ **å®é™…æ•ˆæœ**ï¼šå°±åƒæ±½è½¦ä»ªè¡¨ç›˜ï¼Œä¸€ç›®äº†ç„¶åœ°æ˜¾ç¤ºå„ç§æŒ‡æ ‡

**åˆ›å»ºç›‘æ§æ•°æ®JSPé¡µé¢**ï¼š

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<!DOCTYPE html>
<html>
<head>
    <title>ç³»ç»Ÿç›‘æ§é¢æ¿</title>
    <meta charset="UTF-8">
    <style>
        .dashboard { 
            font-family: Arial; 
            margin: 20px; 
        }
        .metric-card { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin: 10px; 
            border-radius: 5px; 
            display: inline-block; 
            width: 200px;
        }
        .metric-title { 
            font-weight: bold; 
            color: #333; 
        }
        .metric-value { 
            font-size: 24px; 
            color: #007bff; 
        }
        .status-ok { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-error { color: #dc3545; }
    </style>
    <script>
        // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
        setInterval(function() {
            location.reload();
        }, 30000);
    </script>
</head>
<body>
    <div class="dashboard">
        <h1>ğŸ–¥ï¸ ç³»ç»Ÿç›‘æ§é¢æ¿</h1>
        <p>æœ€åæ›´æ–°æ—¶é—´: <%= new java.util.Date() %></p>
        
        <!-- å†…å­˜ä½¿ç”¨æƒ…å†µ -->
        <div class="metric-card">
            <div class="metric-title">ğŸ’¾ å†…å­˜ä½¿ç”¨ç‡</div>
            <div class="metric-value">
                <%= application.getAttribute("memoryUsage") != null ? 
                    application.getAttribute("memoryUsage") + "%" : "N/A" %>
            </div>
        </div>
        
        <!-- CPUä½¿ç”¨æƒ…å†µ -->
        <div class="metric-card">
            <div class="metric-title">âš¡ CPUä½¿ç”¨ç‡</div>
            <div class="metric-value">
                <%= application.getAttribute("cpuUsage") != null ? 
                    application.getAttribute("cpuUsage") + "%" : "N/A" %>
            </div>
        </div>
        
        <!-- åœ¨çº¿ç”¨æˆ·æ•° -->
        <div class="metric-card">
            <div class="metric-title">ğŸ‘¥ åœ¨çº¿ç”¨æˆ·</div>
            <div class="metric-value">
                <%= application.getAttribute("onlineUsers") != null ? 
                    application.getAttribute("onlineUsers") + " äºº" : "0 äºº" %>
            </div>
        </div>
        
        <!-- æ•°æ®åº“è¿æ¥æ±  -->
        <div class="metric-card">
            <div class="metric-title">ğŸ—„ï¸ æ•°æ®åº“è¿æ¥</div>
            <div class="metric-value">
                <%= application.getAttribute("dbActiveConnections") != null ? 
                    application.getAttribute("dbActiveConnections") + "/" +
                    application.getAttribute("dbTotalConnections") : "N/A" %>
            </div>
        </div>
        
        <!-- ç³»ç»Ÿå¥åº·çŠ¶æ€ -->
        <div class="metric-card">
            <div class="metric-title">ğŸ¥ ç³»ç»Ÿå¥åº·</div>
            <div class="metric-value status-ok">
                <%
                    Object healthStatus = application.getAttribute("healthStatus");
                    if (healthStatus != null) {
                        // å‡è®¾HealthStatusæœ‰isHealthy()æ–¹æ³•
                        out.print("âœ… å¥åº·");
                    } else {
                        out.print("âš ï¸ æ£€æŸ¥ä¸­");
                    }
                %>
            </div>
        </div>
        
        <!-- æ€§èƒ½ç»Ÿè®¡ -->
        <h2>ğŸ“ˆ è¯·æ±‚æ€§èƒ½ç»Ÿè®¡</h2>
        <table border="1" style="border-collapse: collapse; width: 100%;">
            <tr>
                <th>æ¥å£</th>
                <th>è¯·æ±‚æ¬¡æ•°</th>
                <th>å¹³å‡å“åº”æ—¶é—´</th>
                <th>æœ€å¤§å“åº”æ—¶é—´</th>
            </tr>
            <%
                @SuppressWarnings("unchecked")
                java.util.Map<String, Object> performanceStats = 
                    (java.util.Map<String, Object>) application.getAttribute("performanceStats");
                
                if (performanceStats != null) {
                    for (java.util.Map.Entry<String, Object> entry : performanceStats.entrySet()) {
                        String uri = entry.getKey();
                        // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…çš„PerformanceStatsç±»æ¥è·å–æ•°æ®
                        out.print("<tr>");
                        out.print("<td>" + uri + "</td>");
                        out.print("<td>-</td>"); // å®é™…é¡¹ç›®ä¸­è·å–çœŸå®æ•°æ®
                        out.print("<td>-</td>");
                        out.print("<td>-</td>");
                        out.print("</tr>");
                    }
                } else {
                    out.print("<tr><td colspan='4'>æš‚æ— æ•°æ®</td></tr>");
                }
            %>
        </table>
    </div>
</body>
</html>
```

### 7.2 å‘Šè­¦é€šçŸ¥æœºåˆ¶


**å®ç°ä¸€ä¸ªç®€å•çš„å‘Šè­¦ç®¡ç†å™¨**ï¼š

```java
public class AlertManager {
    private static final Logger logger = LoggerFactory.getLogger(AlertManager.class);
    private static AlertManager instance;
    private List<AlertChannel> alertChannels;
    
    private AlertManager() {
        alertChannels = new ArrayList<>();
        // æ·»åŠ ä¸åŒçš„å‘Šè­¦æ¸ é“
        alertChannels.add(new ConsoleAlertChannel());
        alertChannels.add(new EmailAlertChannel());
        // alertChannels.add(new SMSAlertChannel()); // å¦‚æœéœ€è¦çš„è¯
    }
    
    public static AlertManager getInstance() {
        if (instance == null) {
            synchronized (AlertManager.class) {
                if (instance == null) {
                    instance = new AlertManager();
                }
            }
        }
        return instance;
    }
    
    public void sendAlert(String message) {
        sendAlert("ç³»ç»Ÿå‘Šè­¦", message, AlertLevel.WARNING);
    }
    
    public void sendAlert(String title, String message, AlertLevel level) {
        Alert alert = new Alert(title, message, level, System.currentTimeMillis());
        
        for (AlertChannel channel : alertChannels) {
            try {
                channel.sendAlert(alert);
            } catch (Exception e) {
                logger.error("å‘é€å‘Šè­¦å¤±è´¥: " + channel.getClass().getSimpleName(), e);
            }
        }
    }
    
    // å‘Šè­¦çº§åˆ«
    public enum AlertLevel {
        INFO("â„¹ï¸", "ä¿¡æ¯"),
        WARNING("âš ï¸", "è­¦å‘Š"), 
        ERROR("âŒ", "é”™è¯¯"),
        CRITICAL("ğŸš¨", "ä¸¥é‡");
        
        private final String emoji;
        private final String description;
        
        AlertLevel(String emoji, String description) {
            this.emoji = emoji;
            this.description = description;
        }
        
        public String getEmoji() { return emoji; }
        public String getDescription() { return description; }
    }
    
    // å‘Šè­¦ä¿¡æ¯
    public static class Alert {
        private String title;
        private String message;
        private AlertLevel level;
        private long timestamp;
        
        public Alert(String title, String message, AlertLevel level, long timestamp) {
            this.title = title;
            this.message = message;
            this.level = level;
            this.timestamp = timestamp;
        }
        
        // getteræ–¹æ³•çœç•¥...
    }
    
    // æ§åˆ¶å°å‘Šè­¦æ¸ é“
    public static class ConsoleAlertChannel implements AlertChannel {
        @Override
        public void sendAlert(Alert alert) {
            System.out.printf("%s [%s] %s: %s%n", 
                alert.level.getEmoji(),
                new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new java.util.Date(alert.timestamp)),
                alert.title,
                alert.message
            );
        }
    }
    
    // é‚®ä»¶å‘Šè­¦æ¸ é“ï¼ˆç®€åŒ–å®ç°ï¼‰
    public static class EmailAlertChannel implements AlertChannel {
        @Override
        public void sendAlert(Alert alert) {
            // è¿™é‡Œå®ç°é‚®ä»¶å‘é€é€»è¾‘
            // å®é™…é¡¹ç›®ä¸­éœ€è¦é…ç½®SMTPæœåŠ¡å™¨
            System.out.println("ğŸ“§ é‚®ä»¶å‘Šè­¦: " + alert.title + " - " + alert.message);
        }
    }
    
    // å‘Šè­¦æ¸ é“æ¥å£
    public interface AlertChannel {
        void sendAlert(Alert alert);
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


ğŸ¯ **ç³»ç»Ÿç›‘æ§çš„æœ¬è´¨**ï¼š
- **é¢„é˜²ä¸ºä¸»**ï¼šåœ¨é—®é¢˜å‘ç”Ÿå‰å‘ç°è‹—å¤´
- **è‡ªåŠ¨åŒ–**ï¼šå‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜å“åº”é€Ÿåº¦  
- **æ•°æ®é©±åŠ¨**ï¼šåŸºäºçœŸå®æ•°æ®åšå†³ç­–
- **åˆ†å±‚ç›‘æ§**ï¼šä»åº”ç”¨åˆ°ç³»ç»Ÿå…¨æ–¹ä½è¦†ç›–

ğŸ“Š **ç›‘æ§çš„å››ä¸ªç»´åº¦**ï¼š
```
ğŸ” å‘ç°é—®é¢˜: é€šè¿‡ç›‘å¬å™¨å®æ—¶æ„ŸçŸ¥å¼‚å¸¸
ğŸ“Š æ”¶é›†æ•°æ®: è®°å½•ç³»ç»Ÿè¿è¡Œçš„å…³é”®æŒ‡æ ‡  
ğŸš¨ åŠæ—¶å‘Šè­¦: é—®é¢˜å‘ç”Ÿæ—¶ç«‹å³é€šçŸ¥ç›¸å…³äººå‘˜
ğŸ”§ è‡ªåŠ¨æ¢å¤: ç®€å•é—®é¢˜ç³»ç»Ÿè‡ªåŠ¨å¤„ç†
```

### 8.2 ç›‘å¬å™¨åœ¨ç›‘æ§ä¸­çš„ä¼˜åŠ¿


âœ… **å¤©ç„¶ä¼˜åŠ¿**ï¼š
- **äº‹ä»¶é©±åŠ¨**ï¼šç³»ç»ŸçŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘
- **è½»é‡çº§**ï¼šå¯¹ç³»ç»Ÿæ€§èƒ½å½±å“å°
- **å…¨ç”Ÿå‘½å‘¨æœŸ**ï¼šè¦†ç›–åº”ç”¨ä»å¯åŠ¨åˆ°å…³é—­
- **æ ‡å‡†åŒ–**ï¼šJavaWebè§„èŒƒåŸç”Ÿæ”¯æŒ

ğŸ”§ **å®é™…åº”ç”¨ä»·å€¼**ï¼š
- **æå‰é¢„è­¦**ï¼šåœ¨ç”¨æˆ·å‘ç°é—®é¢˜å‰å°±çŸ¥é“
- **å¿«é€Ÿå®šä½**ï¼šé€šè¿‡ç›‘æ§æ•°æ®å¿«é€Ÿæ‰¾åˆ°é—®é¢˜æ ¹æº
- **è‡ªåŠ¨å¤„ç†**ï¼šç®€å•é—®é¢˜æ— éœ€äººå·¥å¹²é¢„
- **æ•°æ®ç§¯ç´¯**ï¼šä¸ºç³»ç»Ÿä¼˜åŒ–æä¾›ä¾æ®

### 8.3 æœ€ä½³å®è·µå»ºè®®


ğŸ’¡ **å¼€å‘å»ºè®®**ï¼š
- **é€‚åº¦ç›‘æ§**ï¼šä¸è¦ç›‘æ§æ‰€æœ‰ä¸œè¥¿ï¼Œé‡ç‚¹å…³æ³¨æ ¸å¿ƒæŒ‡æ ‡
- **åˆç†é˜ˆå€¼**ï¼šå‘Šè­¦é˜ˆå€¼ä¸è¦è®¾ç½®å¾—å¤ªæ•æ„Ÿæˆ–å¤ªè¿Ÿé’
- **åˆ†çº§å‘Šè­¦**ï¼šä¸åŒçº§åˆ«çš„é—®é¢˜é‡‡ç”¨ä¸åŒçš„é€šçŸ¥æ–¹å¼
- **è‡ªåŠ¨æ¢å¤**ï¼šèƒ½è‡ªåŠ¨è§£å†³çš„é—®é¢˜å°±ä¸è¦äººå·¥ä»‹å…¥

âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
- **é¿å…ç›‘æ§é£æš´**ï¼šé˜²æ­¢ç›‘æ§ç³»ç»Ÿæœ¬èº«æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
- **å‘Šè­¦ç–²åŠ³**ï¼šé¿å…è¿‡å¤šæ— ç”¨å‘Šè­¦è®©äººéº»æœ¨
- **æ•°æ®å­˜å‚¨**ï¼šç›‘æ§æ•°æ®è¦å®šæœŸæ¸…ç†ï¼Œé¿å…å ç”¨è¿‡å¤šå­˜å‚¨
- **å®‰å…¨è€ƒè™‘**ï¼šç›‘æ§æ•°æ®å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¦æ³¨æ„ä¿æŠ¤

ğŸš€ **è¿›é˜¶æ–¹å‘**ï¼š
- **æœºå™¨å­¦ä¹ **ï¼šä½¿ç”¨AIæŠ€æœ¯é¢„æµ‹ç³»ç»Ÿå¼‚å¸¸
- **å¯è§†åŒ–å¢å¼º**ï¼šé›†æˆä¸“ä¸šç›‘æ§å·¥å…·å¦‚Grafana
- **åˆ†å¸ƒå¼ç›‘æ§**ï¼šå¾®æœåŠ¡ç¯å¢ƒä¸‹çš„é“¾è·¯ç›‘æ§
- **ä¸šåŠ¡ç›‘æ§**ï¼šé™¤äº†æŠ€æœ¯æŒ‡æ ‡ï¼Œè¿˜è¦å…³æ³¨ä¸šåŠ¡æŒ‡æ ‡

ğŸ§  **æ ¸å¿ƒè®°å¿†**ï¼š
- ç›‘å¬å™¨æ˜¯å¤©ç„¶çš„ç›‘æ§å·¥å…·ï¼Œèƒ½å¤Ÿå®æ—¶æ„ŸçŸ¥ç³»ç»Ÿå˜åŒ–
- å¥½çš„ç›‘æ§ç³»ç»Ÿåº”è¯¥æ˜¯é¢„é˜²æ€§çš„ï¼Œè€Œä¸æ˜¯è¢«åŠ¨å“åº”çš„
- ç›‘æ§è¦åˆ†å±‚æ¬¡ã€æœ‰é‡ç‚¹ï¼Œä¸æ˜¯è¶Šå¤šè¶Šå¥½
- è‡ªåŠ¨åŒ–æ˜¯ç›‘æ§ç³»ç»Ÿçš„æ ¸å¿ƒä»·å€¼ï¼Œèƒ½è‡ªåŠ¨è§£å†³çš„é—®é¢˜å°±ä¸è¦äººå·¥å¤„ç†

**æœ€ç»ˆç†è§£**ï¼šé€šè¿‡ç›‘å¬å™¨å®ç°çš„ç³»ç»Ÿç›‘æ§ï¼Œå°±åƒç»™ä½ çš„Webåº”ç”¨é…å¤‡äº†ä¸€ä¸ª24å°æ—¶ä¸ä¼‘æ¯çš„"å¥åº·ç®¡å®¶"ï¼Œæ—¶åˆ»å…³æ³¨ç€ç³»ç»Ÿçš„å„ç§æŒ‡æ ‡ï¼Œä¸€æ—¦å‘ç°å¼‚å¸¸ç«‹å³é‡‡å–è¡ŒåŠ¨ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½ã€‚