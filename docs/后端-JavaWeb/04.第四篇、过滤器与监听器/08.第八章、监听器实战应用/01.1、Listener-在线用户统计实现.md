---
title: 1ã€Listener-åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡å®ç°
---
## ğŸ“š ç›®å½•

1. [åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡ç³»ç»Ÿæ¦‚è¿°](#1-åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡ç³»ç»Ÿæ¦‚è¿°)
2. [HttpSessionListeneræ ¸å¿ƒåº”ç”¨](#2-HttpSessionListeneræ ¸å¿ƒåº”ç”¨)
3. [ç”¨æˆ·ä¸Šçº¿ä¸‹çº¿ç›‘å¬æœºåˆ¶](#3-ç”¨æˆ·ä¸Šçº¿ä¸‹çº¿ç›‘å¬æœºåˆ¶)
4. [åœ¨çº¿äººæ•°å®æ—¶è®¡ç®—](#4-åœ¨çº¿äººæ•°å®æ—¶è®¡ç®—)
5. [ç”¨æˆ·åˆ—è¡¨ç»´æŠ¤ç­–ç•¥](#5-ç”¨æˆ·åˆ—è¡¨ç»´æŠ¤ç­–ç•¥)
6. [å¹¶å‘å®‰å…¨å¤„ç†æ–¹æ¡ˆ](#6-å¹¶å‘å®‰å…¨å¤„ç†æ–¹æ¡ˆ)
7. [ç»Ÿè®¡æ•°æ®å±•ç¤ºå®ç°](#7-ç»Ÿè®¡æ•°æ®å±•ç¤ºå®ç°)
8. [å†…å­˜ä¼˜åŒ–ç­–ç•¥](#8-å†…å­˜ä¼˜åŒ–ç­–ç•¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŸ åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡ç³»ç»Ÿæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡

ğŸ¯ **ç®€å•ç†è§£**ï¼šå°±åƒå•†åº—é—¨å£çš„è®¡æ•°å™¨ï¼Œè®°å½•æœ‰å¤šå°‘é¡¾å®¢åœ¨åº—é‡Œ

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
ç½‘å§ç®¡ç†ç³»ç»Ÿ â†’ è®°å½•æœ‰å¤šå°‘äººåœ¨ä¸Šç½‘
å›¾ä¹¦é¦†åº§ä½ç³»ç»Ÿ â†’ æ˜¾ç¤ºæœ‰å¤šå°‘äººåœ¨é˜…è¯»
è§†é¢‘ç›´æ’­é—´ â†’ æ˜¾ç¤ºæœ‰å¤šå°‘è§‚ä¼—åœ¨çº¿

Webç³»ç»Ÿä¸­ï¼š
ç”¨æˆ·ç™»å½• â†’ åœ¨çº¿äººæ•°+1
ç”¨æˆ·é€€å‡º â†’ åœ¨çº¿äººæ•°-1
é¡µé¢æ˜¾ç¤º â†’ å½“å‰XXäººåœ¨çº¿
```

**ğŸ”¸ åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡çš„æ ¸å¿ƒä»·å€¼**
```
ä¸šåŠ¡ä»·å€¼ï¼š
âœ… äº†è§£ç½‘ç«™æ´»è·ƒåº¦
âœ… ç›‘æ§ç³»ç»Ÿè´Ÿè½½æƒ…å†µ
âœ… ä¸ºè¿è¥å†³ç­–æä¾›æ•°æ®
âœ… æå‡ç”¨æˆ·ä½“éªŒæ„ŸçŸ¥

æŠ€æœ¯ä»·å€¼ï¼š
âœ… ç›‘æ§SessionçŠ¶æ€
âœ… å†…å­˜ä½¿ç”¨æƒ…å†µè¿½è¸ª
âœ… ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡æ”¶é›†
âœ… å¼‚å¸¸æƒ…å†µé¢„è­¦
```

### 1.2 ç³»ç»Ÿå®ç°æ€è·¯

**ğŸ“‹ æ•´ä½“æ¶æ„è®¾è®¡**

```
å®ç°æ€è·¯åˆ†è§£ï¼š

æ­¥éª¤1ï¼šç›‘å¬Sessionåˆ›å»º
ç”¨æˆ·è®¿é—®ç½‘ç«™ â†’ åˆ›å»ºSession â†’ è§¦å‘ç›‘å¬å™¨

æ­¥éª¤2ï¼šè®°å½•ç”¨æˆ·ä¿¡æ¯
æå–ç”¨æˆ·æ ‡è¯† â†’ å­˜å‚¨åˆ°é›†åˆ â†’ æ›´æ–°åœ¨çº¿è®¡æ•°

æ­¥éª¤3ï¼šç›‘å¬Sessioné”€æ¯
ç”¨æˆ·é€€å‡º/è¶…æ—¶ â†’ é”€æ¯Session â†’ ä»é›†åˆç§»é™¤

æ­¥éª¤4ï¼šå®æ—¶æ•°æ®å±•ç¤º
é¡µé¢è¯·æ±‚ â†’ è¯»å–ç»Ÿè®¡æ•°æ® â†’ æ˜¾ç¤ºç»™ç”¨æˆ·
```

**ğŸ¨ æŠ€æœ¯é€‰å‹è¯´æ˜**
| æŠ€æœ¯ç»„ä»¶ | **ä½œç”¨** | **ä¸ºä»€ä¹ˆé€‰æ‹©** |
|---------|---------|--------------|
| ğŸ”¸ **HttpSessionListener** | `Sessionç”Ÿå‘½å‘¨æœŸç›‘å¬` | `è‡ªåŠ¨è§¦å‘ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨` |
| ğŸ”¸ **ConcurrentHashMap** | `çº¿ç¨‹å®‰å…¨çš„ç”¨æˆ·å­˜å‚¨` | `é«˜å¹¶å‘ä¸‹æ•°æ®ä¸€è‡´æ€§` |
| ğŸ”¸ **AtomicInteger** | `åŸå­æ€§è®¡æ•°å™¨` | `çº¿ç¨‹å®‰å…¨çš„æ•°å­—æ“ä½œ` |
| ğŸ”¸ **ServletContext** | `å…¨å±€æ•°æ®å…±äº«` | `æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®ç»Ÿè®¡æ•°æ®` |

---

## 2. ğŸ”§ HttpSessionListeneræ ¸å¿ƒåº”ç”¨


### 2.1 HttpSessionListeneråŸºç¡€ç†è§£

**ğŸ¯ Sessionç›‘å¬å™¨å°±åƒé—¨å«**

```
é—¨å«çš„å·¥ä½œï¼š
æœ‰äººè¿›é—¨ â†’ ç™»è®°å§“å â†’ å‘æ”¾é—¨å¡
æœ‰äººå‡ºé—¨ â†’ å›æ”¶é—¨å¡ â†’ æ³¨é”€è®°å½•

Sessionç›‘å¬å™¨ï¼š
åˆ›å»ºSession â†’ sessionCreated() â†’ è®°å½•ç”¨æˆ·
é”€æ¯Session â†’ sessionDestroyed() â†’ ç§»é™¤ç”¨æˆ·
```

### 2.2 ç›‘å¬å™¨å®ç°åŸºç¡€æ¡†æ¶

**ğŸ—ï¸ åŸºç¡€ç›‘å¬å™¨ç»“æ„**

```java
// åŸºç¡€çš„Sessionç›‘å¬å™¨
@WebListener
public class OnlineUserListener implements HttpSessionListener {
    
    // Sessionåˆ›å»ºæ—¶è§¦å‘
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        System.out.println("æœ‰æ–°ç”¨æˆ·è®¿é—®ç½‘ç«™äº†ï¼");
        // è¿™é‡Œä¼šå†™æˆ‘ä»¬çš„ç»Ÿè®¡é€»è¾‘
    }
    
    // Sessioné”€æ¯æ—¶è§¦å‘
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        System.out.println("æœ‰ç”¨æˆ·ç¦»å¼€ç½‘ç«™äº†ï¼");
        // è¿™é‡Œä¼šå†™æˆ‘ä»¬çš„æ¸…ç†é€»è¾‘
    }
}
```

**ğŸ’¡ ç›‘å¬å™¨å·¥ä½œæ—¶æœºè¯¦è§£**
```
Sessionåˆ›å»ºè§¦å‘æ—¶æœºï¼š
- ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™
- è°ƒç”¨request.getSession()æ–¹æ³•
- JSPé¡µé¢é»˜è®¤åˆ›å»ºSession

Sessioné”€æ¯è§¦å‘æ—¶æœºï¼š
- ç”¨æˆ·ä¸»åŠ¨é€€å‡ºç™»å½•
- Sessionè¶…æ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰
- æœåŠ¡å™¨é‡å¯
- è°ƒç”¨session.invalidate()
```

### 2.3 è·å–Sessionç›¸å…³ä¿¡æ¯

**ğŸ“Š ä»Sessionä¸­æå–æœ‰ç”¨ä¿¡æ¯**

```java
@Override
public void sessionCreated(HttpSessionEvent se) {
    HttpSession session = se.getSession();
    
    // è·å–Session IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
    String sessionId = session.getId();
    
    // è·å–åˆ›å»ºæ—¶é—´
    long createTime = session.getCreationTime();
    Date createDate = new Date(createTime);
    
    // è·å–æœ€åè®¿é—®æ—¶é—´
    long lastAccessTime = session.getLastAccessedTime();
    
    // è·å–è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    int timeout = session.getMaxInactiveInterval();
    
    System.out.println("æ–°Sessionåˆ›å»º: " + sessionId);
    System.out.println("åˆ›å»ºæ—¶é—´: " + createDate);
    System.out.println("è¶…æ—¶è®¾ç½®: " + timeout + "ç§’");
}
```

**ğŸ” Sessionä¿¡æ¯çš„å®é™…åº”ç”¨**
```
SessionIDç”¨é€”ï¼š
- ä½œä¸ºç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†
- æ—¥å¿—è®°å½•å’Œé—®é¢˜æ’æŸ¥
- ç»Ÿè®¡æ•°æ®çš„å…³è”é”®

æ—¶é—´ä¿¡æ¯ç”¨é€”ï¼š
- è®¡ç®—ç”¨æˆ·åœ¨çº¿æ—¶é•¿
- åˆ†æç”¨æˆ·æ´»è·ƒæ—¶æ®µ
- ä¼šè¯è¶…æ—¶ç®¡ç†

è¶…æ—¶ä¿¡æ¯ç”¨é€”ï¼š
- é¢„ä¼°Sessionæ¸…ç†æ—¶é—´
- ä¼˜åŒ–å†…å­˜ä½¿ç”¨
- ç”¨æˆ·ä½“éªŒæ”¹å–„
```

---

## 3. ğŸ‘¥ ç”¨æˆ·ä¸Šçº¿ä¸‹çº¿ç›‘å¬æœºåˆ¶


### 3.1 ç”¨æˆ·ä¸Šçº¿ç›‘å¬å®ç°

**ğŸ“ˆ ç”¨æˆ·è¿›å…¥ç³»ç»Ÿçš„å¤„ç†æµç¨‹**

```java
@WebListener
public class OnlineUserListener implements HttpSessionListener {
    
    // ç”¨æˆ·ä¸Šçº¿å¤„ç†
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        
        // 1. è·å–ç”¨æˆ·åŸºç¡€ä¿¡æ¯
        String sessionId = session.getId();
        String userIP = getCurrentUserIP(session);
        Date loginTime = new Date();
        
        // 2. åˆ›å»ºåœ¨çº¿ç”¨æˆ·å¯¹è±¡
        OnlineUser user = new OnlineUser();
        user.setSessionId(sessionId);
        user.setUserIP(userIP);
        user.setLoginTime(loginTime);
        
        // 3. æ·»åŠ åˆ°åœ¨çº¿ç”¨æˆ·é›†åˆ
        addOnlineUser(user);
        
        // 4. æ›´æ–°ç»Ÿè®¡æ•°æ®
        increaseOnlineCount();
        
        System.out.println("ç”¨æˆ·ä¸Šçº¿: " + userIP + " å½“å‰åœ¨çº¿: " + getOnlineCount());
    }
    
    // è·å–ç”¨æˆ·IPçš„è¾…åŠ©æ–¹æ³•
    private String getCurrentUserIP(HttpSession session) {
        // ä»Sessionä¸­è·å–Requestä¿¡æ¯
        ServletContext context = session.getServletContext();
        // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦é…åˆå…¶ä»–æ–¹å¼è·å–IP
        return "127.0.0.1"; // ç¤ºä¾‹IP
    }
}
```

**ğŸ¯ ç”¨æˆ·ä¿¡æ¯æ”¶é›†ç­–ç•¥**
```
åŸºç¡€ä¿¡æ¯æ”¶é›†ï¼š
- Session IDï¼ˆå¿…éœ€ï¼‰
- ç”¨æˆ·IPåœ°å€
- ç™»å½•æ—¶é—´
- æµè§ˆå™¨ä¿¡æ¯

æ‰©å±•ä¿¡æ¯æ”¶é›†ï¼š
- ç”¨æˆ·ç™»å½•åï¼ˆéœ€è¦ç™»å½•åè®¾ç½®ï¼‰
- è®¿é—®é¡µé¢è·¯å¾„
- ç”¨æˆ·è®¾å¤‡ç±»å‹
- åœ°ç†ä½ç½®ä¿¡æ¯
```

### 3.2 ç”¨æˆ·ä¸‹çº¿ç›‘å¬å®ç°

**ğŸ“‰ ç”¨æˆ·ç¦»å¼€ç³»ç»Ÿçš„å¤„ç†æµç¨‹**

```java
@Override
public void sessionDestroyed(HttpSessionEvent se) {
    HttpSession session = se.getSession();
    
    // 1. è·å–è¦ç¦»å¼€çš„ç”¨æˆ·ä¿¡æ¯
    String sessionId = session.getId();
    
    // 2. ä»åœ¨çº¿ç”¨æˆ·é›†åˆä¸­ç§»é™¤
    OnlineUser removedUser = removeOnlineUser(sessionId);
    
    // 3. æ›´æ–°ç»Ÿè®¡æ•°æ®
    decreaseOnlineCount();
    
    // 4. è®°å½•ç”¨æˆ·ç¦»çº¿ä¿¡æ¯
    if (removedUser != null) {
        Date logoutTime = new Date();
        long onlineTime = logoutTime.getTime() - removedUser.getLoginTime().getTime();
        
        System.out.println("ç”¨æˆ·ä¸‹çº¿: " + removedUser.getUserIP());
        System.out.println("åœ¨çº¿æ—¶é•¿: " + (onlineTime / 1000) + "ç§’");
        System.out.println("å½“å‰åœ¨çº¿: " + getOnlineCount());
        
        // 5. å¯é€‰ï¼šè®°å½•åˆ°æ—¥å¿—æˆ–æ•°æ®åº“
        recordUserSession(removedUser, logoutTime, onlineTime);
    }
}
```

### 3.3 ç‰¹æ®Šæƒ…å†µå¤„ç†

**âš ï¸ å¼‚å¸¸ä¸‹çº¿æƒ…å†µçš„å¤„ç†**

```
å¸¸è§å¼‚å¸¸ä¸‹çº¿æƒ…å†µï¼š

1. æµè§ˆå™¨ç›´æ¥å…³é—­
   - Sessionä¸ä¼šç«‹å³é”€æ¯
   - è¦ç­‰åˆ°è¶…æ—¶æ‰è§¦å‘ç›‘å¬å™¨
   - ç”¨æˆ·çœ‹èµ·æ¥è¿˜"åœ¨çº¿"ä½†å®é™…å·²ç¦»å¼€

2. ç½‘ç»œè¿æ¥ä¸­æ–­
   - æœåŠ¡å™¨ç«¯Sessionä¾ç„¶å­˜åœ¨
   - ç”¨æˆ·å®é™…å·²æ— æ³•è®¿é—®
   - éœ€è¦ç»“åˆå¿ƒè·³æ£€æµ‹

3. æœåŠ¡å™¨é‡å¯
   - æ‰€æœ‰Sessionè¢«æ¸…ç©º
   - åœ¨çº¿ç”¨æˆ·æ•°æ®ä¸¢å¤±
   - éœ€è¦è€ƒè™‘æ•°æ®æŒä¹…åŒ–

è§£å†³ç­–ç•¥ï¼š
âœ… è®¾ç½®åˆç†çš„Sessionè¶…æ—¶æ—¶é—´
âœ… å®ç°JavaScriptå¿ƒè·³æ£€æµ‹
âœ… æä¾›æ‰‹åŠ¨åˆ·æ–°åœ¨çº¿çŠ¶æ€åŠŸèƒ½
âœ… è€ƒè™‘å°†æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“
```

**ğŸ’¡ å¿ƒè·³æ£€æµ‹å®ç°æ€è·¯**
```javascript
// å‰ç«¯å¿ƒè·³æ£€æµ‹ï¼ˆJavaScriptï¼‰
setInterval(function() {
    // æ¯5åˆ†é’Ÿå‘æœåŠ¡å™¨å‘é€å¿ƒè·³
    fetch('/heartbeat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    });
}, 5 * 60 * 1000); // 5åˆ†é’Ÿ
```

---

## 4. ğŸ”¢ åœ¨çº¿äººæ•°å®æ—¶è®¡ç®—


### 4.1 è®¡æ•°å™¨è®¾è®¡ä¸å®ç°

**ğŸ“Š çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨**

```java
// åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡ç®¡ç†ç±»
public class OnlineUserManager {
    
    // ä½¿ç”¨åŸå­æ•´æ•°ä¿è¯çº¿ç¨‹å®‰å…¨
    private static final AtomicInteger onlineCount = new AtomicInteger(0);
    
    // åœ¨çº¿ç”¨æˆ·è¯¦ç»†ä¿¡æ¯å­˜å‚¨
    private static final ConcurrentHashMap<String, OnlineUser> onlineUsers = 
        new ConcurrentHashMap<>();
    
    // å¢åŠ åœ¨çº¿äººæ•°
    public static void increaseCount() {
        int current = onlineCount.incrementAndGet();
        System.out.println("åœ¨çº¿äººæ•°å¢åŠ ï¼Œå½“å‰: " + current);
    }
    
    // å‡å°‘åœ¨çº¿äººæ•°
    public static void decreaseCount() {
        int current = onlineCount.decrementAndGet();
        // é˜²æ­¢è®¡æ•°å˜æˆè´Ÿæ•°
        if (current < 0) {
            onlineCount.set(0);
            current = 0;
        }
        System.out.println("åœ¨çº¿äººæ•°å‡å°‘ï¼Œå½“å‰: " + current);
    }
    
    // è·å–å½“å‰åœ¨çº¿äººæ•°
    public static int getCurrentCount() {
        return onlineCount.get();
    }
    
    // è·å–è¯¦ç»†åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
    public static Collection<OnlineUser> getOnlineUsers() {
        return onlineUsers.values();
    }
}
```

**ğŸ”’ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨AtomicIntegerï¼Ÿ**
```
æ™®é€šintçš„é—®é¢˜ï¼š
çº¿ç¨‹Aè¯»å–å€¼: 100
çº¿ç¨‹Bè¯»å–å€¼: 100  â† åŒæ—¶è¯»å–
çº¿ç¨‹AåŠ 1å†™å›: 101
çº¿ç¨‹BåŠ 1å†™å›: 101  â† ä¸¢å¤±äº†ä¸€æ¬¡æ“ä½œï¼
ç»“æœï¼šåº”è¯¥æ˜¯102ï¼Œå®é™…æ˜¯101

AtomicIntegerçš„ä¼˜åŠ¿ï¼š
- ä¿è¯è¯»å–-ä¿®æ”¹-å†™å…¥çš„åŸå­æ€§
- å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®ä¸€è‡´æ€§
- æ€§èƒ½æ¯”synchronizedæ›´å¥½
- æä¾›ä¾¿åˆ©çš„å¢å‡æ–¹æ³•
```

### 4.2 å®æ—¶æ•°æ®æ›´æ–°æœºåˆ¶

**âš¡ æ•°æ®æ›´æ–°çš„å®Œæ•´æµç¨‹**

```java
// å®Œæ•´çš„åœ¨çº¿ç”¨æˆ·ç›‘å¬å™¨
@WebListener
public class OnlineUserListener implements HttpSessionListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        String sessionId = session.getId();
        
        // åˆ›å»ºç”¨æˆ·å¯¹è±¡
        OnlineUser user = new OnlineUser();
        user.setSessionId(sessionId);
        user.setLoginTime(new Date());
        
        // æ·»åŠ åˆ°ç®¡ç†å™¨
        OnlineUserManager.addUser(sessionId, user);
        OnlineUserManager.increaseCount();
        
        // æ›´æ–°åˆ°ServletContextä¾›é¡µé¢è®¿é—®
        updateContextData(session.getServletContext());
        
        // é€šçŸ¥å…¶ä»–ç»„ä»¶ï¼ˆå¯é€‰ï¼‰
        notifyUserOnline(user);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        String sessionId = session.getId();
        
        // ä»ç®¡ç†å™¨ç§»é™¤
        OnlineUser user = OnlineUserManager.removeUser(sessionId);
        OnlineUserManager.decreaseCount();
        
        // æ›´æ–°ä¸Šä¸‹æ–‡æ•°æ®
        updateContextData(session.getServletContext());
        
        // é€šçŸ¥å…¶ä»–ç»„ä»¶
        notifyUserOffline(user);
    }
    
    // æ›´æ–°ServletContextä¸­çš„æ•°æ®
    private void updateContextData(ServletContext context) {
        context.setAttribute("onlineCount", OnlineUserManager.getCurrentCount());
        context.setAttribute("onlineUsers", OnlineUserManager.getOnlineUsers());
    }
}
```

### 4.3 æ•°æ®å±•ç¤ºæ¥å£å®ç°

**ğŸ“± ä¸ºå‰ç«¯æä¾›æ•°æ®æ¥å£**

```java
// åœ¨çº¿ç”¨æˆ·æ•°æ®æ¥å£Servlet
@WebServlet("/online-stats")
public class OnlineStatsServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        
        response.setContentType("application/json;charset=UTF-8");
        
        // è·å–ç»Ÿè®¡æ•°æ®
        int onlineCount = OnlineUserManager.getCurrentCount();
        Collection<OnlineUser> onlineUsers = OnlineUserManager.getOnlineUsers();
        
        // æ„å»ºJSONå“åº”
        JSONObject result = new JSONObject();
        result.put("onlineCount", onlineCount);
        result.put("updateTime", new Date().getTime());
        
        JSONArray userArray = new JSONArray();
        for (OnlineUser user : onlineUsers) {
            JSONObject userObj = new JSONObject();
            userObj.put("sessionId", user.getSessionId());
            userObj.put("loginTime", user.getLoginTime().getTime());
            userObj.put("userIP", user.getUserIP());
            userArray.add(userObj);
        }
        result.put("users", userArray);
        
        response.getWriter().write(result.toString());
    }
}
```

**ğŸ¨ å‰ç«¯å®æ—¶æ›´æ–°æ˜¾ç¤º**
```javascript
// å‰ç«¯å®æ—¶æ›´æ–°åœ¨çº¿äººæ•°
function updateOnlineCount() {
    fetch('/online-stats')
        .then(response => response.json())
        .then(data => {
            // æ›´æ–°åœ¨çº¿äººæ•°æ˜¾ç¤º
            document.getElementById('online-count').textContent = data.onlineCount;
            
            // æ›´æ–°ç”¨æˆ·åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
            updateUserList(data.users);
            
            console.log('å½“å‰åœ¨çº¿ç”¨æˆ·: ' + data.onlineCount);
        })
        .catch(error => console.error('è·å–åœ¨çº¿æ•°æ®å¤±è´¥:', error));
}

// æ¯30ç§’æ›´æ–°ä¸€æ¬¡
setInterval(updateOnlineCount, 30000);

// é¡µé¢åŠ è½½æ—¶ç«‹å³æ›´æ–°
document.addEventListener('DOMContentLoaded', updateOnlineCount);
```

---

## 5. ğŸ“‹ ç”¨æˆ·åˆ—è¡¨ç»´æŠ¤ç­–ç•¥


### 5.1 ç”¨æˆ·ä¿¡æ¯å¯¹è±¡è®¾è®¡

**ğŸ‘¤ åœ¨çº¿ç”¨æˆ·ä¿¡æ¯ç»“æ„**

```java
// åœ¨çº¿ç”¨æˆ·ä¿¡æ¯ç±»
public class OnlineUser {
    private String sessionId;        // Sessionå”¯ä¸€æ ‡è¯†
    private String username;         // ç”¨æˆ·åï¼ˆç™»å½•åè®¾ç½®ï¼‰
    private String userIP;          // ç”¨æˆ·IPåœ°å€
    private Date loginTime;         // ç™»å½•æ—¶é—´
    private Date lastActiveTime;    // æœ€åæ´»è·ƒæ—¶é—´
    private String userAgent;       // æµè§ˆå™¨ä¿¡æ¯
    private int pageViews;          // é¡µé¢è®¿é—®æ¬¡æ•°
    
    // æ„é€ æ–¹æ³•
    public OnlineUser() {
        this.loginTime = new Date();
        this.lastActiveTime = new Date();
        this.pageViews = 1;
    }
    
    // æ›´æ–°æœ€åæ´»è·ƒæ—¶é—´
    public void updateActiveTime() {
        this.lastActiveTime = new Date();
        this.pageViews++;
    }
    
    // è®¡ç®—åœ¨çº¿æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
    public long getOnlineMinutes() {
        return (System.currentTimeMillis() - loginTime.getTime()) / (1000 * 60);
    }
    
    // åˆ¤æ–­æ˜¯å¦é•¿æ—¶é—´æœªæ´»è·ƒ
    public boolean isInactive(int minutes) {
        long inactiveTime = System.currentTimeMillis() - lastActiveTime.getTime();
        return inactiveTime > (minutes * 60 * 1000);
    }
    
    // getterå’Œsetteræ–¹æ³•çœç•¥...
}
```

**ğŸ“Š ç”¨æˆ·ä¿¡æ¯çš„åˆ†ç±»ç®¡ç†**
```
åŸºç¡€ä¿¡æ¯ï¼ˆå¿…éœ€ï¼‰ï¼š
- SessionID â†’ å”¯ä¸€æ ‡è¯†
- IPåœ°å€ â†’ ç”¨æˆ·æ¥æº
- ç™»å½•æ—¶é—´ â†’ ä¼šè¯å¼€å§‹

åŠ¨æ€ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ï¼š
- ç”¨æˆ·å â†’ ç™»å½•åè·å¾—
- æœ€åæ´»è·ƒæ—¶é—´ â†’ å®æ—¶æ›´æ–°
- é¡µé¢è®¿é—®æ¬¡æ•° â†’ æ´»è·ƒåº¦æŒ‡æ ‡

æ‰©å±•ä¿¡æ¯ï¼ˆé«˜çº§ï¼‰ï¼š
- æµè§ˆå™¨ç±»å‹ â†’ ç»Ÿè®¡åˆ†æ
- æ“ä½œç³»ç»Ÿ â†’ å…¼å®¹æ€§åˆ†æ  
- åœ°ç†ä½ç½® â†’ åœ°åŸŸåˆ†å¸ƒ
```

### 5.2 ç”¨æˆ·åˆ—è¡¨çš„CRUDæ“ä½œ

**ğŸ”§ å®Œæ•´çš„ç”¨æˆ·ç®¡ç†æ“ä½œ**

```java
// å¢å¼ºçš„åœ¨çº¿ç”¨æˆ·ç®¡ç†å™¨
public class OnlineUserManager {
    
    // çº¿ç¨‹å®‰å…¨çš„ç”¨æˆ·å­˜å‚¨
    private static final ConcurrentHashMap<String, OnlineUser> onlineUsers = 
        new ConcurrentHashMap<>();
    
    private static final AtomicInteger onlineCount = new AtomicInteger(0);
    
    // æ·»åŠ ç”¨æˆ·
    public static void addUser(String sessionId, OnlineUser user) {
        onlineUsers.put(sessionId, user);
        onlineCount.incrementAndGet();
        
        System.out.println("ç”¨æˆ·ä¸Šçº¿: " + sessionId + " æ€»è®¡: " + onlineCount.get());
    }
    
    // ç§»é™¤ç”¨æˆ·
    public static OnlineUser removeUser(String sessionId) {
        OnlineUser user = onlineUsers.remove(sessionId);
        if (user != null) {
            onlineCount.decrementAndGet();
            System.out.println("ç”¨æˆ·ä¸‹çº¿: " + sessionId + " æ€»è®¡: " + onlineCount.get());
        }
        return user;
    }
    
    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    public static void updateUser(String sessionId, String username) {
        OnlineUser user = onlineUsers.get(sessionId);
        if (user != null) {
            user.setUsername(username);
            user.updateActiveTime();
        }
    }
    
    // è·å–æŒ‡å®šç”¨æˆ·
    public static OnlineUser getUser(String sessionId) {
        return onlineUsers.get(sessionId);
    }
    
    // è·å–æ‰€æœ‰ç”¨æˆ·
    public static Collection<OnlineUser> getAllUsers() {
        return new ArrayList<>(onlineUsers.values());
    }
    
    // æŒ‰æ¡ä»¶æŸ¥è¯¢ç”¨æˆ·
    public static List<OnlineUser> getUsersByIP(String ip) {
        return onlineUsers.values().stream()
            .filter(user -> ip.equals(user.getUserIP()))
            .collect(Collectors.toList());
    }
    
    // è·å–æ´»è·ƒç”¨æˆ·ï¼ˆæœ€è¿‘5åˆ†é’Ÿæœ‰æ´»åŠ¨ï¼‰
    public static List<OnlineUser> getActiveUsers(int minutes) {
        return onlineUsers.values().stream()
            .filter(user -> !user.isInactive(minutes))
            .collect(Collectors.toList());
    }
}
```

### 5.3 ç”¨æˆ·æ´»è·ƒåº¦è¿½è¸ª

**ğŸ“ˆ ç›‘æ§ç”¨æˆ·æ´»è·ƒçŠ¶æ€**

```java
// ç”¨æˆ·æ´»è·ƒåº¦ç›‘å¬è¿‡æ»¤å™¨
@WebFilter("/*")
public class UserActivityFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpSession session = httpRequest.getSession(false);
        
        // å¦‚æœSessionå­˜åœ¨ï¼Œæ›´æ–°ç”¨æˆ·æ´»è·ƒæ—¶é—´
        if (session != null) {
            String sessionId = session.getId();
            OnlineUser user = OnlineUserManager.getUser(sessionId);
            
            if (user != null) {
                // æ›´æ–°æœ€åæ´»è·ƒæ—¶é—´å’Œé¡µé¢è®¿é—®æ¬¡æ•°
                user.updateActiveTime();
                
                // è®°å½•è®¿é—®çš„é¡µé¢è·¯å¾„
                String requestURI = httpRequest.getRequestURI();
                user.addVisitedPage(requestURI);
                
                System.out.println("ç”¨æˆ·æ´»åŠ¨: " + sessionId + " è®¿é—®: " + requestURI);
            }
        }
        
        // ç»§ç»­è¯·æ±‚å¤„ç†
        chain.doFilter(request, response);
    }
}
```

**ğŸ’¡ æ´»è·ƒåº¦ç»Ÿè®¡çš„åº”ç”¨åœºæ™¯**
```
å®æ—¶ç›‘æ§åº”ç”¨ï¼š
- è¯†åˆ«åƒµå°¸Sessionï¼ˆé•¿æ—¶é—´æ— æ´»åŠ¨ï¼‰
- ç»Ÿè®¡ç”¨æˆ·å¹³å‡åœ¨çº¿æ—¶é•¿
- åˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼

ç³»ç»Ÿä¼˜åŒ–åº”ç”¨ï¼š
- åˆç†è®¾ç½®Sessionè¶…æ—¶æ—¶é—´
- æå‰æ¸…ç†ä¸æ´»è·ƒç”¨æˆ·
- ä¼˜åŒ–æœåŠ¡å™¨å†…å­˜ä½¿ç”¨

ä¸šåŠ¡åˆ†æåº”ç”¨ï¼š
- ç”¨æˆ·ç²˜æ€§åˆ†æ
- é¡µé¢å—æ¬¢è¿ç¨‹åº¦ç»Ÿè®¡
- ç”¨æˆ·è®¿é—®è·¯å¾„åˆ†æ
```

---

## 6. ğŸ›¡ï¸ å¹¶å‘å®‰å…¨å¤„ç†æ–¹æ¡ˆ


### 6.1 å¹¶å‘å®‰å…¨é—®é¢˜åˆ†æ

**âš ï¸ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ½œåœ¨é—®é¢˜**

```
å¹¶å‘å®‰å…¨é—®é¢˜åœºæ™¯ï¼š

åœºæ™¯1ï¼šåŒæ—¶åˆ›å»ºå¤šä¸ªSession
çº¿ç¨‹Aï¼šåˆ›å»ºSessionï¼Œå‡†å¤‡æ·»åŠ ç”¨æˆ·
çº¿ç¨‹Bï¼šåŒæ—¶åˆ›å»ºSessionï¼Œä¹Ÿå‡†å¤‡æ·»åŠ ç”¨æˆ·
é—®é¢˜ï¼šå¯èƒ½å¯¼è‡´è®¡æ•°ä¸å‡†ç¡®

åœºæ™¯2ï¼šSessionåˆ›å»ºå’Œé”€æ¯åŒæ—¶å‘ç”Ÿ
çº¿ç¨‹Aï¼šç”¨æˆ·Aä¸Šçº¿ï¼Œå‡†å¤‡å¢åŠ è®¡æ•°
çº¿ç¨‹Bï¼šç”¨æˆ·Bä¸‹çº¿ï¼Œå‡†å¤‡å‡å°‘è®¡æ•°
é—®é¢˜ï¼šæ“ä½œé¡ºåºé”™ä¹±ï¼Œç»“æœä¸æ­£ç¡®

åœºæ™¯3ï¼šè¯»å†™åŒæ—¶è¿›è¡Œ
çº¿ç¨‹Aï¼šæ­£åœ¨è¯»å–ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤º
çº¿ç¨‹Bï¼šæ­£åœ¨ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
é—®é¢˜ï¼šå¯èƒ½è¯»å–åˆ°ä¸ä¸€è‡´çš„æ•°æ®
```

**ğŸ¯ å¹¶å‘å®‰å…¨è§£å†³ç­–ç•¥**
```
ç­–ç•¥é€‰æ‹©å¯¹æ¯”ï¼š

synchronizedå…³é”®å­—ï¼š
ä¼˜ç‚¹ï¼šç®€å•æ˜“ç”¨ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨
ç¼ºç‚¹ï¼šæ€§èƒ½å¼€é”€å¤§ï¼Œå¯èƒ½å¯¼è‡´é˜»å¡

ConcurrentHashMapï¼š
ä¼˜ç‚¹ï¼šé«˜å¹¶å‘æ€§èƒ½å¥½ï¼Œè¯»æ“ä½œä¸é˜»å¡
ç¼ºç‚¹ï¼šåªä¿è¯å•ä¸ªæ“ä½œåŸå­æ€§

åŸå­ç±»ï¼ˆAtomicï¼‰ï¼š
ä¼˜ç‚¹ï¼šæ— é”ç¼–ç¨‹ï¼Œæ€§èƒ½æœ€å¥½
ç¼ºç‚¹ï¼šåªé€‚ç”¨äºç®€å•æ•°å€¼æ“ä½œ

è¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰ï¼š
ä¼˜ç‚¹ï¼šè¯»å¤šå†™å°‘åœºæ™¯æ€§èƒ½å¥½
ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™
```

### 6.2 çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ¡ˆ

**ğŸ”’ é‡‡ç”¨ConcurrentHashMap + AtomicIntegeræ–¹æ¡ˆ**

```java
// çº¿ç¨‹å®‰å…¨çš„ç”¨æˆ·ç®¡ç†å®ç°
public class ThreadSafeOnlineUserManager {
    
    // çº¿ç¨‹å®‰å…¨çš„Mapå­˜å‚¨ç”¨æˆ·
    private static final ConcurrentHashMap<String, OnlineUser> onlineUsers = 
        new ConcurrentHashMap<>();
    
    // åŸå­æ•´æ•°ä¿è¯è®¡æ•°å®‰å…¨
    private static final AtomicInteger onlineCount = new AtomicInteger(0);
    
    // è¯»å†™é”ç”¨äºå¤æ‚æ“ä½œ
    private static final ReentrantReadWriteLock rwLock = new ReentrantReadWriteLock();
    
    // å®‰å…¨æ·»åŠ ç”¨æˆ·
    public static void addUser(String sessionId, OnlineUser user) {
        // ä½¿ç”¨putIfAbsentç¡®ä¿ä¸é‡å¤æ·»åŠ 
        OnlineUser existing = onlineUsers.putIfAbsent(sessionId, user);
        
        if (existing == null) {
            // åªæœ‰çœŸæ­£æ·»åŠ äº†æ–°ç”¨æˆ·æ‰å¢åŠ è®¡æ•°
            int count = onlineCount.incrementAndGet();
            System.out.println("ç”¨æˆ·å®‰å…¨ä¸Šçº¿: " + sessionId + " æ€»æ•°: " + count);
        } else {
            System.out.println("ç”¨æˆ·å·²å­˜åœ¨ï¼Œå¿½ç•¥é‡å¤æ·»åŠ : " + sessionId);
        }
    }
    
    // å®‰å…¨ç§»é™¤ç”¨æˆ·
    public static OnlineUser removeUser(String sessionId) {
        OnlineUser user = onlineUsers.remove(sessionId);
        
        if (user != null) {
            int count = onlineCount.decrementAndGet();
            // é˜²æ­¢è®¡æ•°å˜ä¸ºè´Ÿæ•°
            if (count < 0) {
                onlineCount.set(0);
                count = 0;
            }
            System.out.println("ç”¨æˆ·å®‰å…¨ä¸‹çº¿: " + sessionId + " æ€»æ•°: " + count);
        }
        
        return user;
    }
    
    // å®‰å…¨è·å–å½“å‰è®¡æ•°
    public static int getCurrentCount() {
        return onlineCount.get();
    }
    
    // å®‰å…¨è·å–ç”¨æˆ·å¿«ç…§
    public static List<OnlineUser> getUserSnapshot() {
        // ä½¿ç”¨è¯»é”ä¿è¯æ•°æ®ä¸€è‡´æ€§
        rwLock.readLock().lock();
        try {
            return new ArrayList<>(onlineUsers.values());
        } finally {
            rwLock.readLock().unlock();
        }
    }
}
```

### 6.3 æ•°æ®ä¸€è‡´æ€§ä¿è¯

**âœ… ç¡®ä¿ç»Ÿè®¡æ•°æ®çš„å‡†ç¡®æ€§**

```java
// æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å’Œä¿®å¤
public class DataConsistencyChecker {
    
    // å®šæœŸæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
    public static void checkConsistency() {
        int mapSize = OnlineUserManager.onlineUsers.size();
        int atomicCount = OnlineUserManager.onlineCount.get();
        
        if (mapSize != atomicCount) {
            System.err.println("æ•°æ®ä¸ä¸€è‡´æ£€æµ‹!");
            System.err.println("Mapå¤§å°: " + mapSize + ", è®¡æ•°å™¨: " + atomicCount);
            
            // ä¿®å¤è®¡æ•°å™¨
            OnlineUserManager.onlineCount.set(mapSize);
            System.out.println("å·²ä¿®å¤è®¡æ•°å™¨ä¸º: " + mapSize);
        }
    }
    
    // æ¸…ç†è¿‡æœŸSession
    public static void cleanupInactiveSessions(int inactiveMinutes) {
        List<String> toRemove = new ArrayList<>();
        
        // æ‰¾å‡ºä¸æ´»è·ƒçš„Session
        for (Map.Entry<String, OnlineUser> entry : 
             OnlineUserManager.onlineUsers.entrySet()) {
            
            OnlineUser user = entry.getValue();
            if (user.isInactive(inactiveMinutes)) {
                toRemove.add(entry.getKey());
            }
        }
        
        // æ‰¹é‡ç§»é™¤ä¸æ´»è·ƒç”¨æˆ·
        for (String sessionId : toRemove) {
            OnlineUserManager.removeUser(sessionId);
            System.out.println("æ¸…ç†ä¸æ´»è·ƒç”¨æˆ·: " + sessionId);
        }
        
        if (!toRemove.isEmpty()) {
            System.out.println("æœ¬æ¬¡æ¸…ç†äº† " + toRemove.size() + " ä¸ªä¸æ´»è·ƒç”¨æˆ·");
        }
    }
}
```

**â° å®šæ—¶ä»»åŠ¡ç»´æŠ¤æ•°æ®ä¸€è‡´æ€§**
```java
// ä½¿ç”¨å®šæ—¶å™¨ç»´æŠ¤æ•°æ®è´¨é‡
@WebListener
public class DataMaintenanceListener implements ServletContextListener {
    
    private ScheduledExecutorService scheduler;
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        scheduler = Executors.newScheduledThreadPool(1);
        
        // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ•°æ®ä¸€è‡´æ€§
        scheduler.scheduleAtFixedRate(() -> {
            DataConsistencyChecker.checkConsistency();
        }, 5, 5, TimeUnit.MINUTES);
        
        // æ¯30åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡ä¸æ´»è·ƒç”¨æˆ·
        scheduler.scheduleAtFixedRate(() -> {
            DataConsistencyChecker.cleanupInactiveSessions(30);
        }, 30, 30, TimeUnit.MINUTES);
        
        System.out.println("æ•°æ®ç»´æŠ¤ä»»åŠ¡å·²å¯åŠ¨");
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        if (scheduler != null) {
            scheduler.shutdown();
            System.out.println("æ•°æ®ç»´æŠ¤ä»»åŠ¡å·²åœæ­¢");
        }
    }
}
```

---

## 7. ğŸ“Š ç»Ÿè®¡æ•°æ®å±•ç¤ºå®ç°


### 7.1 åç«¯æ•°æ®æ¥å£è®¾è®¡

**ğŸ”Œ RESTfulé£æ ¼çš„æ•°æ®æ¥å£**

```java
// ç»Ÿè®¡æ•°æ®API Servlet
@WebServlet("/api/online/*")
public class OnlineStatsAPIServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        
        response.setContentType("application/json;charset=UTF-8");
        response.setHeader("Access-Control-Allow-Origin", "*"); // CORSæ”¯æŒ
        
        String pathInfo = request.getPathInfo();
        
        try {
            switch (pathInfo) {
                case "/count":
                    handleCountRequest(response);
                    break;
                case "/users":
                    handleUsersRequest(response);
                    break;
                case "/stats":
                    handleStatsRequest(response);
                    break;
                default:
                    response.sendError(404, "æ¥å£ä¸å­˜åœ¨");
            }
        } catch (Exception e) {
            handleError(response, e);
        }
    }
    
    // å¤„ç†åœ¨çº¿äººæ•°è¯·æ±‚
    private void handleCountRequest(HttpServletResponse response) throws IOException {
        JSONObject result = new JSONObject();
        result.put("success", true);
        result.put("onlineCount", OnlineUserManager.getCurrentCount());
        result.put("timestamp", System.currentTimeMillis());
        
        response.getWriter().write(result.toString());
    }
    
    // å¤„ç†ç”¨æˆ·åˆ—è¡¨è¯·æ±‚
    private void handleUsersRequest(HttpServletResponse response) throws IOException {
        JSONObject result = new JSONObject();
        JSONArray userArray = new JSONArray();
        
        for (OnlineUser user : OnlineUserManager.getAllUsers()) {
            JSONObject userObj = new JSONObject();
            userObj.put("sessionId", user.getSessionId().substring(0, 8) + "..."); // éšç§ä¿æŠ¤
            userObj.put("username", user.getUsername() != null ? user.getUsername() : "è®¿å®¢");
            userObj.put("loginTime", user.getLoginTime().getTime());
            userObj.put("onlineMinutes", user.getOnlineMinutes());
            userObj.put("pageViews", user.getPageViews());
            userArray.add(userObj);
        }
        
        result.put("success", true);
        result.put("users", userArray);
        result.put("total", userArray.size());
        
        response.getWriter().write(result.toString());
    }
    
    // å¤„ç†ç»Ÿè®¡ä¿¡æ¯è¯·æ±‚
    private void handleStatsRequest(HttpServletResponse response) throws IOException {
        List<OnlineUser> allUsers = OnlineUserManager.getAllUsers();
        
        // è®¡ç®—ç»Ÿè®¡æ•°æ®
        int totalUsers = allUsers.size();
        int activeUsers = (int) allUsers.stream()
            .filter(user -> !user.isInactive(5))
            .count();
        long avgOnlineTime = allUsers.stream()
            .mapToLong(OnlineUser::getOnlineMinutes)
            .sum() / Math.max(totalUsers, 1);
        
        JSONObject result = new JSONObject();
        result.put("success", true);
        result.put("totalOnline", totalUsers);
        result.put("activeUsers", activeUsers);
        result.put("inactiveUsers", totalUsers - activeUsers);
        result.put("avgOnlineMinutes", avgOnlineTime);
        
        response.getWriter().write(result.toString());
    }
}
```

### 7.2 å‰ç«¯é¡µé¢å±•ç¤ºå®ç°

**ğŸ¨ åŠ¨æ€çš„ç”¨æˆ·ç•Œé¢**

```jsp
<!-- åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡é¡µé¢ -->
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡</title>
    <style>
        .stats-container { max-width: 1200px; margin: 20px auto; padding: 20px; }
        .stats-card { background: #f5f5f5; padding: 20px; margin: 10px; border-radius: 8px; }
        .online-count { font-size: 2em; color: #4CAF50; font-weight: bold; }
        .user-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .user-table th, .user-table td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        .refresh-btn { background: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="stats-container">
        <h1>åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡ç³»ç»Ÿ</h1>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-card">
            <h2>å®æ—¶æ•°æ®</h2>
            <div class="online-count" id="online-count">åŠ è½½ä¸­...</div>
            <p>å½“å‰åœ¨çº¿ç”¨æˆ·æ•°</p>
            <button class="refresh-btn" onclick="refreshData()">æ‰‹åŠ¨åˆ·æ–°</button>
            <span id="last-update">æœ€åæ›´æ–°ï¼š--</span>
        </div>
        
        <!-- è¯¦ç»†ç»Ÿè®¡ -->
        <div class="stats-card">
            <h2>è¯¦ç»†ç»Ÿè®¡</h2>
            <div id="detailed-stats">
                <p>æ´»è·ƒç”¨æˆ·ï¼š<span id="active-users">--</span></p>
                <p>éæ´»è·ƒç”¨æˆ·ï¼š<span id="inactive-users">--</span></p>
                <p>å¹³å‡åœ¨çº¿æ—¶é•¿ï¼š<span id="avg-time">--</span> åˆ†é’Ÿ</p>
            </div>
        </div>
        
        <!-- ç”¨æˆ·åˆ—è¡¨ -->
        <div class="stats-card">
            <h2>åœ¨çº¿ç”¨æˆ·åˆ—è¡¨</h2>
            <table class="user-table" id="user-table">
                <thead>
                    <tr>
                        <th>ç”¨æˆ·å</th>
                        <th>ç™»å½•æ—¶é—´</th>
                        <th>åœ¨çº¿æ—¶é•¿</th>
                        <th>é¡µé¢è®¿é—®</th>
                    </tr>
                </thead>
                <tbody id="user-list">
                    <tr><td colspan="4">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // åˆ·æ–°æ•°æ®å‡½æ•°
        function refreshData() {
            // è·å–åœ¨çº¿äººæ•°
            fetch('/api/online/count')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('online-count').textContent = data.onlineCount;
                        document.getElementById('last-update').textContent = 
                            'æœ€åæ›´æ–°ï¼š' + new Date().toLocaleTimeString();
                    }
                });
            
            // è·å–è¯¦ç»†ç»Ÿè®¡
            fetch('/api/online/stats')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('active-users').textContent = data.activeUsers;
                        document.getElementById('inactive-users').textContent = data.inactiveUsers;
                        document.getElementById('avg-time').textContent = data.avgOnlineMinutes;
                    }
                });
            
            // è·å–ç”¨æˆ·åˆ—è¡¨
            fetch('/api/online/users')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateUserTable(data.users);
                    }
                });
        }
        
        // æ›´æ–°ç”¨æˆ·è¡¨æ ¼
        function updateUserTable(users) {
            const tbody = document.getElementById('user-list');
            tbody.innerHTML = '';
            
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">æš‚æ— åœ¨çº¿ç”¨æˆ·</td></tr>';
                return;
            }
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${new Date(user.loginTime).toLocaleString()}</td>
                    <td>${user.onlineMinutes} åˆ†é’Ÿ</td>
                    <td>${user.pageViews} æ¬¡</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåç«‹å³åˆ·æ–°æ•°æ®
        document.addEventListener('DOMContentLoaded', refreshData);
        
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
        setInterval(refreshData, 30000);
    </script>
</body>
</html>
```

### 7.3 å®æ—¶æ¨é€å®ç°ï¼ˆWebSocketå¯é€‰ï¼‰

**âš¡ å®æ—¶æ•°æ®æ¨é€æŠ€æœ¯**

```java
// WebSocketå®æ—¶æ¨é€ï¼ˆå¯é€‰é«˜çº§åŠŸèƒ½ï¼‰
@ServerEndpoint("/websocket/online-stats")
public class OnlineStatsWebSocket {
    
    private static Set<Session> sessions = ConcurrentHashMap.newKeySet();
    
    @OnOpen
    public void onOpen(Session session) {
        sessions.add(session);
        System.out.println("WebSocketè¿æ¥å»ºç«‹ï¼š" + session.getId());
        
        // ç«‹å³å‘é€å½“å‰æ•°æ®
        sendCurrentStats(session);
    }
    
    @OnClose
    public void onClose(Session session) {
        sessions.remove(session);
        System.out.println("WebSocketè¿æ¥å…³é—­ï¼š" + session.getId());
    }
    
    // å¹¿æ’­ç»Ÿè®¡æ•°æ®æ›´æ–°
    public static void broadcastStatsUpdate() {
        if (sessions.isEmpty()) return;
        
        JSONObject data = new JSONObject();
        data.put("type", "stats_update");
        data.put("onlineCount", OnlineUserManager.getCurrentCount());
        data.put("timestamp", System.currentTimeMillis());
        
        String message = data.toString();
        
        // å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ›´æ–°
        sessions.forEach(session -> {
            try {
                session.getBasicRemote().sendText(message);
            } catch (IOException e) {
                System.err.println("å‘é€WebSocketæ¶ˆæ¯å¤±è´¥ï¼š" + e.getMessage());
            }
        });
    }
    
    private void sendCurrentStats(Session session) {
        // å‘é€å½“å‰ç»Ÿè®¡æ•°æ®çš„å®ç°
    }
}
```

---

## 8. ğŸ’¾ å†…å­˜ä¼˜åŒ–ç­–ç•¥


### 8.1 å†…å­˜ä½¿ç”¨åˆ†æ

**ğŸ“Š åœ¨çº¿ç”¨æˆ·ç³»ç»Ÿçš„å†…å­˜æ¶ˆè€—**

```
å†…å­˜ä½¿ç”¨æ„æˆåˆ†æï¼š

1. OnlineUserå¯¹è±¡æœ¬èº«
   - åŸºæœ¬å­—æ®µï¼šçº¦200å­—èŠ‚/ç”¨æˆ·
   - å­—ç¬¦ä¸²æ•°æ®ï¼šç”¨æˆ·åã€IPç­‰çº¦100å­—èŠ‚
   - æ—¶é—´å¯¹è±¡ï¼šçº¦50å­—èŠ‚
   å°è®¡ï¼šçº¦350å­—èŠ‚/ç”¨æˆ·

2. ConcurrentHashMapå­˜å‚¨
   - MapèŠ‚ç‚¹å¼€é”€ï¼šçº¦50å­—èŠ‚/æ¡ç›®
   - Keyï¼ˆSessionIDï¼‰ï¼šçº¦150å­—èŠ‚
   å°è®¡ï¼šçº¦200å­—èŠ‚/ç”¨æˆ·

3. æ€»å†…å­˜ä¼°ç®—
   å•ç”¨æˆ·å†…å­˜æ¶ˆè€—ï¼šçº¦550å­—èŠ‚
   1000ç”¨æˆ·çº¦å ç”¨ï¼š550KB
   10000ç”¨æˆ·çº¦å ç”¨ï¼š5.5MB
   
å†…å­˜å¢é•¿é¢„æµ‹ï¼š
- ç”¨æˆ·æ•°é‡çº¿æ€§å¢é•¿
- é•¿æ—¶é—´è¿è¡Œåå¯èƒ½ç´¯ç§¯å¤§é‡æ•°æ®
- éœ€è¦å®šæœŸæ¸…ç†å’Œä¼˜åŒ–
```

### 8.2 å†…å­˜ä¼˜åŒ–å®ç°ç­–ç•¥

**ğŸ”§ å¤šå±‚æ¬¡çš„å†…å­˜ä¼˜åŒ–æ–¹æ¡ˆ**

```java
// å†…å­˜ä¼˜åŒ–çš„ç”¨æˆ·ç®¡ç†å™¨
public class OptimizedOnlineUserManager {
    
    // ä½¿ç”¨WeakHashMapå¸®åŠ©GCå›æ”¶
    private static final Map<String, OnlineUser> onlineUsers = 
        new ConcurrentHashMap<>();
    
    // é™åˆ¶æœ€å¤§ç”¨æˆ·æ•°é‡
    private static final int MAX_USERS = 10000;
    private static final AtomicInteger userCount = new AtomicInteger(0);
    
    // LRUç¼“å­˜ï¼Œè‡ªåŠ¨æ¸…ç†æœ€ä¹…æœªè®¿é—®çš„ç”¨æˆ·
    private static final LinkedHashMap<String, OnlineUser> lruCache = 
        new LinkedHashMap<String, OnlineUser>(16, 0.75f, true) {
            @Override
            protected boolean removeEldestEntry(Map.Entry<String, OnlineUser> eldest) {
                return size() > MAX_USERS;
            }
        };
    
    // ä¼˜åŒ–çš„æ·»åŠ ç”¨æˆ·æ–¹æ³•
    public static boolean addUser(String sessionId, OnlineUser user) {
        // æ£€æŸ¥æ˜¯å¦è¶…å‡ºé™åˆ¶
        if (userCount.get() >= MAX_USERS) {
            System.out.println("ç”¨æˆ·æ•°é‡å·²è¾¾ä¸Šé™ï¼Œæ‹’ç»æ–°ç”¨æˆ·");
            return false;
        }
        
        synchronized (lruCache) {
            OnlineUser existing = lruCache.put(sessionId, user);
            if (existing == null) {
                userCount.incrementAndGet();
                System.out.println("ç”¨æˆ·æ·»åŠ æˆåŠŸï¼Œå½“å‰: " + userCount.get());
                return true;
            }
        }
        return false;
    }
    
    // æ‰¹é‡æ¸…ç†è¿‡æœŸç”¨æˆ·
    public static void cleanupExpiredUsers(int expireMinutes) {
        List<String> toRemove = new ArrayList<>();
        long expireTime = System.currentTimeMillis() - (expireMinutes * 60 * 1000);
        
        synchronized (lruCache) {
            Iterator<Map.Entry<String, OnlineUser>> iterator = 
                lruCache.entrySet().iterator();
            
            while (iterator.hasNext()) {
                Map.Entry<String, OnlineUser> entry = iterator.next();
                OnlineUser user = entry.getValue();
                
                if (user.getLastActiveTime().getTime() < expireTime) {
                    iterator.remove();
                    toRemove.add(entry.getKey());
                }
            }
        }
        
        // æ›´æ–°è®¡æ•°å™¨
        if (!toRemove.isEmpty()) {
            userCount.addAndGet(-toRemove.size());
            System.out.println("æ‰¹é‡æ¸…ç†äº† " + toRemove.size() + " ä¸ªè¿‡æœŸç”¨æˆ·");
        }
    }
}
```

### 8.3 æ•°æ®æŒä¹…åŒ–ç­–ç•¥

**ğŸ’¾ å‡å°‘å†…å­˜ä¾èµ–çš„å­˜å‚¨æ–¹æ¡ˆ**

```java
// æ•°æ®æŒä¹…åŒ–ç®¡ç†
public class UserDataPersistence {
    
    private static final String DATA_FILE = "online_users.dat";
    private static final ObjectMapper mapper = new ObjectMapper();
    
    // å®šæœŸå°†å†…å­˜æ•°æ®å†™å…¥æ–‡ä»¶
    public static void persistUserData() {
        try {
            List<OnlineUser> users = OnlineUserManager.getAllUsers();
            
            // è½¬æ¢ä¸ºè½»é‡çº§çš„æ•°æ®å¯¹è±¡
            List<UserSnapshot> snapshots = users.stream()
                .map(UserSnapshot::new)
                .collect(Collectors.toList());
            
            // å†™å…¥æ–‡ä»¶
            mapper.writeValue(new File(DATA_FILE), snapshots);
            System.out.println("ç”¨æˆ·æ•°æ®å·²æŒä¹…åŒ–ï¼Œå…± " + snapshots.size() + " æ¡");
            
        } catch (IOException e) {
            System.err.println("æŒä¹…åŒ–å¤±è´¥ï¼š" + e.getMessage());
        }
    }
    
    // æœåŠ¡å™¨å¯åŠ¨æ—¶æ¢å¤æ•°æ®
    public static void restoreUserData() {
        try {
            File dataFile = new File(DATA_FILE);
            if (!dataFile.exists()) {
                System.out.println("æ²¡æœ‰æ‰¾åˆ°æŒä¹…åŒ–æ•°æ®æ–‡ä»¶");
                return;
            }
            
            UserSnapshot[] snapshots = mapper.readValue(dataFile, UserSnapshot[].class);
            
            int restoredCount = 0;
            for (UserSnapshot snapshot : snapshots) {
                // æ£€æŸ¥æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆæ¯”å¦‚è¶…è¿‡1å°æ—¶ï¼‰
                if (System.currentTimeMillis() - snapshot.getLastActiveTime() < 3600000) {
                    OnlineUser user = snapshot.toOnlineUser();
                    OnlineUserManager.addUser(snapshot.getSessionId(), user);
                    restoredCount++;
                }
            }
            
            System.out.println("æ¢å¤äº† " + restoredCount + " ä¸ªç”¨æˆ·æ•°æ®");
            
        } catch (IOException e) {
            System.err.println("æ•°æ®æ¢å¤å¤±è´¥ï¼š" + e.getMessage());
        }
    }
    
    // è½»é‡çº§çš„ç”¨æˆ·å¿«ç…§ç±»
    public static class UserSnapshot {
        private String sessionId;
        private String username;
        private String userIP;
        private long loginTime;
        private long lastActiveTime;
        
        public UserSnapshot() {} // JSONååºåˆ—åŒ–éœ€è¦
        
        public UserSnapshot(OnlineUser user) {
            this.sessionId = user.getSessionId();
            this.username = user.getUsername();
            this.userIP = user.getUserIP();
            this.loginTime = user.getLoginTime().getTime();
            this.lastActiveTime = user.getLastActiveTime().getTime();
        }
        
        public OnlineUser toOnlineUser() {
            OnlineUser user = new OnlineUser();
            user.setSessionId(this.sessionId);
            user.setUsername(this.username);
            user.setUserIP(this.userIP);
            user.setLoginTime(new Date(this.loginTime));
            user.setLastActiveTime(new Date(this.lastActiveTime));
            return user;
        }
        
        // getterå’Œsetterçœç•¥...
    }
}
```

### 8.4 JVMå†…å­˜ç›‘æ§

**ğŸ“Š å†…å­˜ä½¿ç”¨æƒ…å†µç›‘æ§**

```java
// å†…å­˜ç›‘æ§å·¥å…·
public class MemoryMonitor {
    
    // è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ
    public static MemoryInfo getMemoryInfo() {
        Runtime runtime = Runtime.getRuntime();
        
        long totalMemory = runtime.totalMemory();      // æ€»å†…å­˜
        long freeMemory = runtime.freeMemory();        // ç©ºé—²å†…å­˜
        long maxMemory = runtime.maxMemory();          // æœ€å¤§å†…å­˜
        long usedMemory = totalMemory - freeMemory;    // å·²ä½¿ç”¨å†…å­˜
        
        return new MemoryInfo(totalMemory, freeMemory, maxMemory, usedMemory);
    }
    
    // æ£€æŸ¥å†…å­˜ä½¿ç”¨æ˜¯å¦è¿‡é«˜
    public static boolean isMemoryUsageHigh() {
        MemoryInfo info = getMemoryInfo();
        double usageRate = (double) info.getUsedMemory() / info.getMaxMemory();
        return usageRate > 0.8; // è¶…è¿‡80%è®¤ä¸ºè¿‡é«˜
    }
    
    // è§¦å‘åƒåœ¾å›æ”¶
    public static void forceGC() {
        System.gc();
        System.out.println("å·²è§¦å‘åƒåœ¾å›æ”¶");
    }
    
    // å†…å­˜æ¸…ç†å»ºè®®
    public static void performMemoryCleanup() {
        if (isMemoryUsageHigh()) {
            System.out.println("å†…å­˜ä½¿ç”¨è¿‡é«˜ï¼Œå¼€å§‹æ¸…ç†...");
            
            // æ¸…ç†è¿‡æœŸç”¨æˆ·
            OptimizedOnlineUserManager.cleanupExpiredUsers(30);
            
            // æŒä¹…åŒ–æ•°æ®
            UserDataPersistence.persistUserData();
            
            // è§¦å‘GC
            forceGC();
            
            System.out.println("å†…å­˜æ¸…ç†å®Œæˆ");
        }
    }
    
    // å†…å­˜ä¿¡æ¯ç±»
    public static class MemoryInfo {
        private final long totalMemory;
        private final long freeMemory;
        private final long maxMemory;
        private final long usedMemory;
        
        public MemoryInfo(long total, long free, long max, long used) {
            this.totalMemory = total;
            this.freeMemory = free;
            this.maxMemory = max;
            this.usedMemory = used;
        }
        
        public double getUsageRate() {
            return (double) usedMemory / maxMemory;
        }
        
        @Override
        public String toString() {
            return String.format(
                "å†…å­˜ä½¿ç”¨: %dMB/%dMB (%.1f%%), ç©ºé—²: %dMB",
                usedMemory / 1024 / 1024,
                maxMemory / 1024 / 1024,
                getUsageRate() * 100,
                freeMemory / 1024 / 1024
            );
        }
        
        // getteræ–¹æ³•çœç•¥...
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ HttpSessionListenerï¼šSessionç”Ÿå‘½å‘¨æœŸç›‘å¬ï¼Œè‡ªåŠ¨å¤„ç†ç”¨æˆ·ä¸Šä¸‹çº¿
ğŸ”¸ åœ¨çº¿ç”¨æˆ·ç®¡ç†ï¼šä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„å­˜å‚¨å’Œç®¡ç†ç”¨æˆ·ä¿¡æ¯
ğŸ”¸ å¹¶å‘å®‰å…¨ï¼šConcurrentHashMap + AtomicIntegerä¿è¯å¤šçº¿ç¨‹å®‰å…¨
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šå®šæ—¶æ£€æŸ¥å’Œä¿®å¤ç»Ÿè®¡æ•°æ®ï¼Œç¡®ä¿å‡†ç¡®æ€§
ğŸ”¸ å†…å­˜ä¼˜åŒ–ï¼šåˆç†çš„æ•°æ®ç»“æ„é€‰æ‹©å’Œå®šæœŸæ¸…ç†ç­–ç•¥
ğŸ”¸ å®æ—¶å±•ç¤ºï¼šRESTful API + å‰ç«¯å®šæ—¶åˆ·æ–°å®ç°æ•°æ®å±•ç¤º
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šè€ƒè™‘ç½‘ç»œä¸­æ–­ã€æœåŠ¡å™¨é‡å¯ç­‰ç‰¹æ®Šæƒ…å†µ
ğŸ”¸ æ€§èƒ½ç›‘æ§ï¼šå†…å­˜ä½¿ç”¨ç›‘æ§å’Œåƒåœ¾å›æ”¶ä¼˜åŒ–
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Sessionç›‘å¬å™¨çš„å·¥ä½œåŸç†**
```
æ ¸å¿ƒæœºåˆ¶ï¼š
- Sessionåˆ›å»ºæ—¶è‡ªåŠ¨è§¦å‘sessionCreated()
- Sessioné”€æ¯æ—¶è‡ªåŠ¨è§¦å‘sessionDestroyed()
- æ— éœ€æ‰‹åŠ¨è°ƒç”¨ï¼Œå®Œå…¨ç”±å®¹å™¨ç®¡ç†

åº”ç”¨ä»·å€¼ï¼š
- å‡†ç¡®è®°å½•ç”¨æˆ·çš„è¿›å…¥å’Œç¦»å¼€
- è‡ªåŠ¨ç»´æŠ¤åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡
- ä¸ºç³»ç»Ÿç›‘æ§æä¾›æ•°æ®åŸºç¡€
```

**ğŸ”¹ å¹¶å‘å®‰å…¨çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹å®‰å…¨ï¼š
- WebæœåŠ¡å™¨åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚
- å¤šä¸ªç”¨æˆ·å¯èƒ½åŒæ—¶ä¸Šçº¿/ä¸‹çº¿
- ä¸åŠ ä¿æŠ¤ä¼šå¯¼è‡´æ•°æ®é”™ä¹±

è§£å†³æ–¹æ¡ˆé€‰æ‹©ï¼š
- ConcurrentHashMapï¼šé«˜æ€§èƒ½çš„çº¿ç¨‹å®‰å…¨Map
- AtomicIntegerï¼šæ— é”çš„åŸå­æ“ä½œè®¡æ•°
- é¿å…ä½¿ç”¨synchronizedï¼šæ€§èƒ½å¼€é”€å¤§
```

**ğŸ”¹ å†…å­˜ä¼˜åŒ–çš„å®è·µæ„ä¹‰**
```
ä¼˜åŒ–å¿…è¦æ€§ï¼š
- å¤§é‡åœ¨çº¿ç”¨æˆ·ä¼šå ç”¨æ˜¾è‘—å†…å­˜
- é•¿æ—¶é—´è¿è¡Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
- å½±å“ç³»ç»Ÿæ•´ä½“æ€§èƒ½

ä¼˜åŒ–ç­–ç•¥ï¼š
- é™åˆ¶æœ€å¤§ç”¨æˆ·æ•°é‡
- å®šæœŸæ¸…ç†ä¸æ´»è·ƒç”¨æˆ·
- ä½¿ç”¨è½»é‡çº§æ•°æ®ç»“æ„
- å®ç°æ•°æ®æŒä¹…åŒ–å‡å°‘å†…å­˜ä¾èµ–
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç¤¾äº¤å¹³å°**ï¼šæ˜¾ç¤ºå¥½å‹åœ¨çº¿çŠ¶æ€ï¼Œæå‡ç”¨æˆ·äº’åŠ¨ä½“éªŒ
- **åœ¨çº¿æ•™è‚²**ï¼šç›‘æ§å­¦ç”Ÿå­¦ä¹ çŠ¶æ€ï¼Œä¼˜åŒ–æ•™å­¦èµ„æºåˆ†é…
- **ç”µå•†ç½‘ç«™**ï¼šåˆ†æç”¨æˆ·æ´»è·ƒåº¦ï¼Œåˆ¶å®šè¥é”€ç­–ç•¥
- **ä¼ä¸šç³»ç»Ÿ**ï¼šç›‘æ§å‘˜å·¥ç³»ç»Ÿä½¿ç”¨æƒ…å†µï¼Œä¼˜åŒ–ITèµ„æº

**ğŸ”§ æŠ€æœ¯å®è·µä»·å€¼**
- **ç³»ç»Ÿç›‘æ§**ï¼šå®æ—¶äº†è§£ç³»ç»Ÿè´Ÿè½½å’Œç”¨æˆ·æ´»è·ƒåº¦
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºæ•°æ®ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½
- **å®¹é‡è§„åˆ’**ï¼šä¸ºæœåŠ¡å™¨æ‰©å®¹æä¾›æ•°æ®æ”¯æŒ
- **é—®é¢˜æ’æŸ¥**ï¼šç”¨æˆ·Sessionå¼‚å¸¸çš„å¿«é€Ÿå®šä½

**ğŸ“ˆ æ‰©å±•åº”ç”¨æ€è·¯**
- **ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼šè®°å½•ç”¨æˆ·è®¿é—®è·¯å¾„ï¼Œåˆ†æä½¿ç”¨ä¹ æƒ¯
- **å®æ—¶é€šçŸ¥ç³»ç»Ÿ**ï¼šç»“åˆWebSocketæ¨é€åœ¨çº¿çŠ¶æ€å˜åŒ–
- **è´Ÿè½½å‡è¡¡ä¼˜åŒ–**ï¼šåŸºäºç”¨æˆ·åˆ†å¸ƒä¼˜åŒ–æœåŠ¡å™¨è´Ÿè½½
- **å®‰å…¨ç›‘æ§**ï¼šæ£€æµ‹å¼‚å¸¸ç™»å½•è¡Œä¸ºï¼Œæå‡ç³»ç»Ÿå®‰å…¨

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Sessionç›‘å¬è‡ªåŠ¨åŒ–ï¼Œä¸Šçº¿ä¸‹çº¿å…¨è®°å½•
- å¹¶å‘å®‰å…¨è¦ä¿è¯ï¼ŒåŸå­æ“ä½œä¸å‡ºé”™
- å†…å­˜ä¼˜åŒ–å¾ˆé‡è¦ï¼Œå®šæœŸæ¸…ç†é˜²æ³„æ¼
- å®æ—¶å±•ç¤ºç”¨æˆ·çˆ±ï¼Œæ•°æ®å‡†ç¡®æ˜¯å…³é”®