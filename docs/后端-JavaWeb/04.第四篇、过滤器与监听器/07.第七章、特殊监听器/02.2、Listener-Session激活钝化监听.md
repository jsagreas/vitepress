---
title: 2ã€Listener-Sessionæ¿€æ´»é’åŒ–ç›‘å¬
---
## ğŸ“š ç›®å½•

1. [Sessionæ¿€æ´»é’åŒ–æ¦‚å¿µ](#1-Sessionæ¿€æ´»é’åŒ–æ¦‚å¿µ)
2. [HttpSessionActivationListeneræ¥å£è¯¦è§£](#2-HttpSessionActivationListeneræ¥å£è¯¦è§£)
3. [é’åŒ–ä¸æ¿€æ´»çš„è§¦å‘æœºåˆ¶](#3-é’åŒ–ä¸æ¿€æ´»çš„è§¦å‘æœºåˆ¶)
4. [ä¼šè¯åºåˆ—åŒ–æ”¯æŒ](#4-ä¼šè¯åºåˆ—åŒ–æ”¯æŒ)
5. [é›†ç¾¤ç¯å¢ƒåº”ç”¨](#5-é›†ç¾¤ç¯å¢ƒåº”ç”¨)
6. [å®é™…åº”ç”¨åœºæ™¯](#6-å®é™…åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ Sessionæ¿€æ´»é’åŒ–æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Sessioné’åŒ–å’Œæ¿€æ´»


**ğŸ’¡ é€šä¿—ç†è§£**
```
é’åŒ–(Passivate)ï¼šæŠŠSessionä»å†…å­˜ä¸­"æ¬èµ°"ï¼Œå­˜å‚¨åˆ°ç¡¬ç›˜ä¸Š
æ¿€æ´»(Activate)ï¼šæŠŠSessionä»ç¡¬ç›˜"æ¬å›"å†…å­˜ä¸­ä½¿ç”¨

å°±åƒç”µè„‘çš„ä¼‘çœ åŠŸèƒ½ï¼š
- é’åŒ– = ç”µè„‘ä¼‘çœ ï¼ŒæŠŠå†…å­˜æ•°æ®å­˜åˆ°ç¡¬ç›˜
- æ¿€æ´» = ç”µè„‘å”¤é†’ï¼ŒæŠŠæ•°æ®é‡æ–°è½½å…¥å†…å­˜
```

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦é’åŒ–æ¿€æ´»**
- **èŠ‚çœå†…å­˜**ï¼šé•¿æ—¶é—´ä¸ç”¨çš„Sessioné‡Šæ”¾å†…å­˜ç©ºé—´
- **æ”¯æŒé›†ç¾¤**ï¼šSessionå¯ä»¥åœ¨ä¸åŒæœåŠ¡å™¨é—´è¿ç§»
- **æŒä¹…åŒ–å­˜å‚¨**ï¼šæœåŠ¡å™¨é‡å¯åSessionæ•°æ®ä¸ä¸¢å¤±
- **æé«˜æ€§èƒ½**ï¼šé¿å…å†…å­˜æº¢å‡ºï¼Œä¿æŒç³»ç»Ÿç¨³å®š

### 1.2 é’åŒ–æ¿€æ´»çš„ç”Ÿå‘½å‘¨æœŸ


```
ç”¨æˆ·è®¿é—® â†’ Sessionåˆ›å»º(å†…å­˜ä¸­) â†’ ç”¨æˆ·ç¦»å¼€
                    â†“
               é•¿æ—¶é—´æ— è®¿é—®
                    â†“
            Sessioné’åŒ–(å­˜å‚¨åˆ°ç£ç›˜)
                    â†“
               ç”¨æˆ·å†æ¬¡è®¿é—®
                    â†“
            Sessionæ¿€æ´»(é‡æ–°è½½å…¥å†…å­˜)
```

### 1.3 è§¦å‘æ¡ä»¶


**ğŸ”¸ é’åŒ–è§¦å‘æ¡ä»¶**
- Sessionè¶…è¿‡ä¸€å®šæ—¶é—´æœªè¢«è®¿é—®
- æœåŠ¡å™¨å†…å­˜ä¸è¶³ï¼Œéœ€è¦é‡Šæ”¾ç©ºé—´
- æœåŠ¡å™¨å‡†å¤‡å…³é—­æˆ–é‡å¯
- é›†ç¾¤ç¯å¢ƒä¸‹Sessionéœ€è¦è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹

**ğŸ”¸ æ¿€æ´»è§¦å‘æ¡ä»¶**
- ç”¨æˆ·å†æ¬¡è®¿é—®ï¼Œéœ€è¦ä½¿ç”¨è¯¥Session
- ä»å…¶ä»–èŠ‚ç‚¹è¿ç§»Sessionåˆ°å½“å‰èŠ‚ç‚¹
- æœåŠ¡å™¨é‡å¯åæ¢å¤Session

---

## 2. ğŸ¯ HttpSessionActivationListeneræ¥å£è¯¦è§£


### 2.1 æ¥å£åŸºæœ¬ç»“æ„


**ğŸ”¸ æ ¸å¿ƒæ¥å£æ–¹æ³•**
```java
public interface HttpSessionActivationListener extends EventListener {
    // Sessionå³å°†è¢«é’åŒ–å‰è°ƒç”¨
    void sessionWillPassivate(HttpSessionEvent se);
    
    // Sessionè¢«æ¿€æ´»åè°ƒç”¨  
    void sessionDidActivate(HttpSessionEvent se);
}
```

**ğŸ’¡ ç†è§£è¦ç‚¹**
- è¿™ä¸ªç›‘å¬å™¨**ä¸éœ€è¦åœ¨web.xmlä¸­æ³¨å†Œ**
- **ç›´æ¥è®©éœ€è¦ç›‘å¬çš„å¯¹è±¡å®ç°è¿™ä¸ªæ¥å£å³å¯**
- å½“å¯¹è±¡è¢«å­˜å…¥Sessionæ—¶ï¼Œè‡ªåŠ¨å…·å¤‡ç›‘å¬èƒ½åŠ›

### 2.2 sessionWillPassivateæ–¹æ³•è¯¦è§£


**ğŸ¯ æ–¹æ³•ä½œç”¨**
- Sessionå³å°†è¢«é’åŒ–æ—¶è°ƒç”¨
- å¯ä»¥åœ¨é’åŒ–å‰åšä¸€äº›æ¸…ç†å·¥ä½œ
- é‡Šæ”¾ä¸éœ€è¦åºåˆ—åŒ–çš„èµ„æº

```java
@Override
public void sessionWillPassivate(HttpSessionEvent se) {
    System.out.println("ç”¨æˆ·å¯¹è±¡å³å°†è¢«é’åŒ–ï¼š" + this.username);
    
    // æ¸…ç†ä¸éœ€è¦åºåˆ—åŒ–çš„èµ„æº
    if (this.connection != null) {
        this.connection.close();  // å…³é—­æ•°æ®åº“è¿æ¥
        this.connection = null;
    }
    
    // è®°å½•é’åŒ–æ—¶é—´
    this.passivateTime = new Date();
}
```

### 2.3 sessionDidActivateæ–¹æ³•è¯¦è§£


**ğŸ¯ æ–¹æ³•ä½œç”¨**
- Sessionè¢«æ¿€æ´»åç«‹å³è°ƒç”¨
- å¯ä»¥é‡æ–°åˆå§‹åŒ–ä¸€äº›èµ„æº
- æ¢å¤å¯¹è±¡çš„å®Œæ•´çŠ¶æ€

```java
@Override
public void sessionDidActivate(HttpSessionEvent se) {
    System.out.println("ç”¨æˆ·å¯¹è±¡å·²è¢«æ¿€æ´»ï¼š" + this.username);
    
    // é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥
    this.connection = DatabaseUtil.getConnection();
    
    // æ›´æ–°æ¿€æ´»æ—¶é—´
    this.activateTime = new Date();
    
    // è®°å½•æ¿€æ´»æ—¥å¿—
    System.out.println("é’åŒ–æ—¶é•¿ï¼š" + (activateTime.getTime() - passivateTime.getTime()) + "æ¯«ç§’");
}
```

---

## 3. âš™ï¸ é’åŒ–ä¸æ¿€æ´»çš„è§¦å‘æœºåˆ¶


### 3.1 Tomcatä¸­çš„é…ç½®


**ğŸ”§ é…ç½®é’åŒ–ç­–ç•¥**

åœ¨Tomcatçš„`conf/context.xml`ä¸­é…ç½®ï¼š

```xml
<Context>
    <!-- é…ç½®Sessionç®¡ç†å™¨ -->
    <Manager className="org.apache.catalina.session.PersistentManager"
             maxIdleSwap="1">  <!-- 1åˆ†é’Ÿä¸æ´»åŠ¨å°±é’åŒ– -->
        
        <!-- æ–‡ä»¶å­˜å‚¨ -->
        <Store className="org.apache.catalina.session.FileStore"
               directory="sessions" />  <!-- å­˜å‚¨ç›®å½• -->
    </Manager>
</Context>
```

**ğŸ“Š é…ç½®å‚æ•°è¯´æ˜**

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `maxIdleSwap` | å¤šå°‘åˆ†é’Ÿä¸æ´»åŠ¨åé’åŒ– | `-1`(ä¸é’åŒ–) |
| `minIdleSwap` | æœ€å°é’åŒ–æ—¶é—´ | `-1` |
| `maxActiveSessions` | å†…å­˜ä¸­æœ€å¤§Sessionæ•° | `-1`(æ— é™åˆ¶) |

### 3.2 é’åŒ–æ¿€æ´»çš„æ—¶æœº


**ğŸ• é’åŒ–æ—¶æœº**
```
æƒ…å†µ1ï¼šè¶…æ—¶é’åŒ–
ç”¨æˆ·1åˆ†é’Ÿæœªè®¿é—® â†’ è‡ªåŠ¨é’åŒ–åˆ°ç£ç›˜

æƒ…å†µ2ï¼šå†…å­˜ä¸è¶³é’åŒ–  
å†…å­˜ä¸­Sessionè¿‡å¤š â†’ é’åŒ–æœ€ä¹…æœªä½¿ç”¨çš„Session

æƒ…å†µ3ï¼šæœåŠ¡å™¨å…³é—­é’åŒ–
Tomcatå…³é—­å‰ â†’ é’åŒ–æ‰€æœ‰æ´»è·ƒSession
```

**ğŸ•‘ æ¿€æ´»æ—¶æœº**
```
æƒ…å†µ1ï¼šç”¨æˆ·è®¿é—®æ¿€æ´»
ç”¨æˆ·å†æ¬¡è®¿é—® â†’ ä»ç£ç›˜åŠ è½½Sessionåˆ°å†…å­˜

æƒ…å†µ2ï¼šæœåŠ¡å™¨å¯åŠ¨æ¿€æ´»
Tomcatå¯åŠ¨æ—¶ â†’ æ¢å¤ä¹‹å‰é’åŒ–çš„Session
```

---

## 4. ğŸ’¾ ä¼šè¯åºåˆ—åŒ–æ”¯æŒ


### 4.1 åºåˆ—åŒ–çš„å¿…è¦æ€§


**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–**
- é’åŒ–æ—¶éœ€è¦å°†å¯¹è±¡å†™å…¥ç£ç›˜
- é›†ç¾¤é—´ä¼ è¾“Sessionéœ€è¦åºåˆ—åŒ–
- åºåˆ—åŒ–æ˜¯Javaå¯¹è±¡æŒä¹…åŒ–çš„æ ‡å‡†æ–¹å¼

**âš ï¸ åºåˆ—åŒ–è¦æ±‚**
- å­˜å‚¨åœ¨Sessionä¸­çš„å¯¹è±¡**å¿…é¡»å®ç°Serializableæ¥å£**
- å¯¹è±¡çš„æ‰€æœ‰å±æ€§ä¹Ÿå¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„
- transientå…³é”®å­—çš„å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–

### 4.2 å®Œæ•´çš„ç”¨æˆ·å¯¹è±¡ç¤ºä¾‹


```java
public class User implements Serializable, HttpSessionActivationListener {
    // åºåˆ—åŒ–ç‰ˆæœ¬å·ï¼ˆé‡è¦ï¼ï¼‰
    private static final long serialVersionUID = 1L;
    
    // å¯åºåˆ—åŒ–å±æ€§
    private String username;
    private String email;
    private Date loginTime;
    
    // ä¸åºåˆ—åŒ–çš„å±æ€§ï¼ˆç”¨transientä¿®é¥°ï¼‰
    private transient Connection connection;
    private transient Date lastAccessTime;
    
    // é’åŒ–å‰çš„æ¸…ç†å·¥ä½œ
    @Override
    public void sessionWillPassivate(HttpSessionEvent se) {
        System.out.println("ç”¨æˆ·[" + username + "]å³å°†è¢«é’åŒ–");
        
        // å…³é—­æ•°æ®åº“è¿æ¥ï¼ˆå› ä¸ºè¿æ¥ä¸èƒ½åºåˆ—åŒ–ï¼‰
        if (connection != null) {
            try {
                connection.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
            connection = null;
        }
    }
    
    // æ¿€æ´»åçš„æ¢å¤å·¥ä½œ
    @Override  
    public void sessionDidActivate(HttpSessionEvent se) {
        System.out.println("ç”¨æˆ·[" + username + "]å·²è¢«æ¿€æ´»");
        
        // é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥
        try {
            connection = DriverManager.getConnection("jdbc:mysql://localhost/test");
        } catch (SQLException e) {
            e.printStackTrace();
        }
        
        // æ›´æ–°æœ€åè®¿é—®æ—¶é—´
        lastAccessTime = new Date();
    }
    
    // getterå’Œsetteræ–¹æ³•...
}
```

### 4.3 åºåˆ—åŒ–æ³¨æ„äº‹é¡¹


**ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶**
```java
// æ·»åŠ åºåˆ—åŒ–ç‰ˆæœ¬å·ï¼Œé¿å…ç‰ˆæœ¬ä¸å…¼å®¹
private static final long serialVersionUID = 1L;
```

**ğŸ”¸ å¤„ç†ä¸å¯åºåˆ—åŒ–å±æ€§**
```java
// ä½¿ç”¨transientå…³é”®å­—
private transient Connection connection;  // æ•°æ®åº“è¿æ¥
private transient Thread workThread;      // çº¿ç¨‹å¯¹è±¡  
private transient File tempFile;         // æ–‡ä»¶å¥æŸ„
```

**ğŸ”¸ è‡ªå®šä¹‰åºåˆ—åŒ–è¿‡ç¨‹**
```java
// è‡ªå®šä¹‰åºåˆ—åŒ–æ–¹æ³•ï¼ˆå¯é€‰ï¼‰
private void writeObject(ObjectOutputStream out) throws IOException {
    out.defaultWriteObject();  // æ‰§è¡Œé»˜è®¤åºåˆ—åŒ–
    // å¯ä»¥æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘
}

private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {
    in.defaultReadObject();   // æ‰§è¡Œé»˜è®¤ååºåˆ—åŒ–  
    // å¯ä»¥æ·»åŠ è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘
}
```

---

## 5. ğŸŒ é›†ç¾¤ç¯å¢ƒåº”ç”¨


### 5.1 é›†ç¾¤ä¸­çš„Sessionè¿ç§»


**ğŸ’¡ é›†ç¾¤åœºæ™¯ç†è§£**
```
åœºæ™¯ï¼šç”¨æˆ·é¦–æ¬¡è®¿é—®æœåŠ¡å™¨Aï¼ŒSessionåˆ›å»ºåœ¨Aä¸Š
åç»­ï¼šè´Ÿè½½å‡è¡¡å™¨å°†ç”¨æˆ·è¯·æ±‚åˆ†é…åˆ°æœåŠ¡å™¨B
é—®é¢˜ï¼šæœåŠ¡å™¨Bä¸Šæ²¡æœ‰ç”¨æˆ·çš„Sessionæ•°æ®
è§£å†³ï¼šSessionéœ€è¦ä»Aè¿ç§»åˆ°Bï¼ˆæ¿€æ´»é’åŒ–æœºåˆ¶ï¼‰
```

**ğŸ”„ è¿ç§»è¿‡ç¨‹**
```
æœåŠ¡å™¨A                    æœåŠ¡å™¨B
   |                         |
   |--[1]é’åŒ–Session-------->|
   |   (åºåˆ—åŒ–åˆ°å…±äº«å­˜å‚¨)      |
   |                         |--[2]æ¿€æ´»Session
   |                         |   (ä»å…±äº«å­˜å‚¨ååºåˆ—åŒ–)
   |                         |
   |                         |--[3]å¤„ç†ç”¨æˆ·è¯·æ±‚
```

### 5.2 é›†ç¾¤é…ç½®ç¤ºä¾‹


**ğŸ”§ å…±äº«å­˜å‚¨é…ç½®**
```xml
<!-- ä½¿ç”¨æ•°æ®åº“å­˜å‚¨Session -->
<Manager className="org.apache.catalina.session.PersistentManager">
    <Store className="org.apache.catalina.session.JDBCStore"
           driverName="com.mysql.jdbc.Driver"
           connectionURL="jdbc:mysql://localhost/sessions"
           connectionName="root"
           connectionPassword="password"
           sessionTable="sessions"
           sessionAppCol="app"
           sessionIdCol="id"
           sessionDataCol="data"
           sessionValidCol="valid"
           sessionMaxInactiveCol="maxinactive"
           sessionLastAccessedCol="lastaccess"/>
</Manager>
```

### 5.3 é›†ç¾¤ç¯å¢ƒç›‘å¬å™¨å®ç°


```java
public class ClusterUser implements Serializable, HttpSessionActivationListener {
    private static final long serialVersionUID = 1L;
    
    private String userId;
    private String serverNode;  // è®°å½•å½“å‰æ‰€åœ¨æœåŠ¡å™¨èŠ‚ç‚¹
    
    @Override
    public void sessionWillPassivate(HttpSessionEvent se) {
        System.out.println("ç”¨æˆ·[" + userId + "]ä»æœåŠ¡å™¨[" + serverNode + "]é’åŒ–");
        
        // è®°å½•é’åŒ–æ—¥å¿—åˆ°æ•°æ®åº“
        logPassivation();
    }
    
    @Override
    public void sessionDidActivate(HttpSessionEvent se) {
        // æ›´æ–°å½“å‰æœåŠ¡å™¨èŠ‚ç‚¹ä¿¡æ¯
        this.serverNode = System.getProperty("server.name");
        System.out.println("ç”¨æˆ·[" + userId + "]åœ¨æœåŠ¡å™¨[" + serverNode + "]æ¿€æ´»");
        
        // è®°å½•æ¿€æ´»æ—¥å¿—
        logActivation();
    }
    
    private void logPassivation() {
        // è®°å½•åˆ°æ—¥å¿—ç³»ç»Ÿ
        System.out.println("Sessioné’åŒ–æ—¶é—´ï¼š" + new Date());
    }
    
    private void logActivation() {
        // è®°å½•åˆ°æ—¥å¿—ç³»ç»Ÿ  
        System.out.println("Sessionæ¿€æ´»æ—¶é—´ï¼š" + new Date());
    }
}
```

---

## 6. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯


### 6.1 è´­ç‰©è½¦åº”ç”¨


**ğŸ›’ è´­ç‰©è½¦é’åŒ–æ¿€æ´»å¤„ç†**
```java
public class ShoppingCart implements Serializable, HttpSessionActivationListener {
    private static final long serialVersionUID = 1L;
    
    private List<CartItem> items;
    private transient BigDecimal cachedTotal;  // ç¼“å­˜æ€»ä»·ï¼ˆä¸åºåˆ—åŒ–ï¼‰
    
    @Override
    public void sessionWillPassivate(HttpSessionEvent se) {
        System.out.println("è´­ç‰©è½¦å³å°†é’åŒ–ï¼Œå•†å“æ•°é‡ï¼š" + items.size());
        
        // æ¸…ç©ºç¼“å­˜çš„è®¡ç®—ç»“æœ
        cachedTotal = null;
    }
    
    @Override
    public void sessionDidActivate(HttpSessionEvent se) {
        System.out.println("è´­ç‰©è½¦å·²æ¿€æ´»ï¼Œå•†å“æ•°é‡ï¼š" + items.size());
        
        // é‡æ–°è®¡ç®—æ€»ä»·ç¼“å­˜
        calculateTotal();
    }
    
    private void calculateTotal() {
        cachedTotal = items.stream()
            .map(item -> item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))
            .reduce(BigDecimal.ZERO, BigDecimal::add);
    }
}
```

### 6.2 åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡


**ğŸ‘¥ ç”¨æˆ·çŠ¶æ€ç›‘æ§**
```java
public class OnlineUserTracker implements Serializable, HttpSessionActivationListener {
    private static final long serialVersionUID = 1L;
    
    private String username;
    private Date loginTime;
    private String sessionId;
    
    @Override
    public void sessionWillPassivate(HttpSessionEvent se) {
        System.out.println("ç”¨æˆ·[" + username + "]Sessionè¢«é’åŒ–");
        
        // æ›´æ–°ç”¨æˆ·çŠ¶æ€ä¸º"éæ´»è·ƒ"
        updateUserStatus("INACTIVE");
        
        // ä»åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ä¸­ç§»é™¤
        OnlineUserManager.removeActiveUser(sessionId);
    }
    
    @Override
    public void sessionDidActivate(HttpSessionEvent se) {
        System.out.println("ç”¨æˆ·[" + username + "]Sessionè¢«æ¿€æ´»");
        
        // æ›´æ–°ç”¨æˆ·çŠ¶æ€ä¸º"æ´»è·ƒ" 
        updateUserStatus("ACTIVE");
        
        // åŠ å…¥åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
        OnlineUserManager.addActiveUser(sessionId, this);
    }
    
    private void updateUserStatus(String status) {
        // æ›´æ–°æ•°æ®åº“ä¸­çš„ç”¨æˆ·çŠ¶æ€
        // UserService.updateUserStatus(username, status);
    }
}
```

### 6.3 èµ„æºæ¸…ç†åº”ç”¨


**ğŸ§¹ ç³»ç»Ÿèµ„æºç®¡ç†**
```java
public class ResourceManager implements Serializable, HttpSessionActivationListener {
    private static final long serialVersionUID = 1L;
    
    // å¯åºåˆ—åŒ–çš„ä¸šåŠ¡æ•°æ®
    private String resourceId;
    private Map<String, String> config;
    
    // ä¸å¯åºåˆ—åŒ–çš„ç³»ç»Ÿèµ„æº
    private transient ExecutorService threadPool;
    private transient ScheduledTask scheduledTask;
    
    @Override
    public void sessionWillPassivate(HttpSessionEvent se) {
        System.out.println("èµ„æºç®¡ç†å™¨å³å°†é’åŒ–ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æº");
        
        // å…³é—­çº¿ç¨‹æ± 
        if (threadPool != null && !threadPool.isShutdown()) {
            threadPool.shutdown();
            threadPool = null;
        }
        
        // å–æ¶ˆå®šæ—¶ä»»åŠ¡
        if (scheduledTask != null) {
            scheduledTask.cancel();
            scheduledTask = null;
        }
    }
    
    @Override
    public void sessionDidActivate(HttpSessionEvent se) {
        System.out.println("èµ„æºç®¡ç†å™¨å·²æ¿€æ´»ï¼Œé‡æ–°åˆ›å»ºç³»ç»Ÿèµ„æº");
        
        // é‡æ–°åˆ›å»ºçº¿ç¨‹æ± 
        threadPool = Executors.newFixedThreadPool(5);
        
        // é‡æ–°å¯åŠ¨å®šæ—¶ä»»åŠ¡
        scheduledTask = new ScheduledTask(config);
        scheduledTask.start();
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é’åŒ–æ¿€æ´»æœ¬è´¨ï¼šSessionåœ¨å†…å­˜å’Œç£ç›˜é—´çš„ç§»åŠ¨
ğŸ”¸ æ¥å£ä½œç”¨ï¼šHttpSessionActivationListenerç›‘å¬é’åŒ–æ¿€æ´»è¿‡ç¨‹
ğŸ”¸ æ–¹æ³•ç†è§£ï¼šsessionWillPassivateé’åŒ–å‰ï¼ŒsessionDidActivateæ¿€æ´»å  
ğŸ”¸ åºåˆ—åŒ–è¦æ±‚ï¼šå­˜å‚¨å¯¹è±¡å¿…é¡»å®ç°Serializableæ¥å£
ğŸ”¸ åº”ç”¨åœºæ™¯ï¼šå†…å­˜ä¼˜åŒ–ã€é›†ç¾¤æ”¯æŒã€èµ„æºæ¸…ç†
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é’åŒ–æ¿€æ´»çš„æ—¶æœº**
```
é’åŒ–æ—¶æœºï¼š
- é•¿æ—¶é—´æœªè®¿é—®ï¼ˆé…ç½®çš„è¶…æ—¶æ—¶é—´ï¼‰
- å†…å­˜ä¸è¶³éœ€è¦é‡Šæ”¾ç©ºé—´
- æœåŠ¡å™¨å…³é—­å‰çš„æ¸…ç†
- é›†ç¾¤é—´Sessionè¿ç§»

æ¿€æ´»æ—¶æœºï¼š  
- ç”¨æˆ·é‡æ–°è®¿é—®éœ€è¦Session
- é›†ç¾¤ä¸­Sessionè¿ç§»åˆ°æ–°èŠ‚ç‚¹
- æœåŠ¡å™¨é‡å¯åæ¢å¤Session
```

**ğŸ”¹ åºåˆ—åŒ–çš„æ³¨æ„äº‹é¡¹**
```
å¿…é¡»åºåˆ—åŒ–ï¼š
- ä¸šåŠ¡æ•°æ®å¯¹è±¡
- é…ç½®ä¿¡æ¯
- ç”¨æˆ·çŠ¶æ€ä¿¡æ¯

ä¸èƒ½åºåˆ—åŒ–ï¼ˆä½¿ç”¨transientï¼‰ï¼š
- æ•°æ®åº“è¿æ¥Connection
- çº¿ç¨‹Threadå¯¹è±¡  
- æ–‡ä»¶å¥æŸ„File
- ç½‘ç»œè¿æ¥Socket
```

**ğŸ”¹ å®é™…åº”ç”¨ä»·å€¼**
- **å†…å­˜ä¼˜åŒ–**ï¼šè‡ªåŠ¨é‡Šæ”¾é•¿æ—¶é—´ä¸ç”¨çš„Sessionï¼ŒèŠ‚çœå†…å­˜
- **é›†ç¾¤æ”¯æŒ**ï¼šSessionå¯ä»¥åœ¨æœåŠ¡å™¨é—´è¿ç§»ï¼Œæé«˜ç³»ç»Ÿå¯ç”¨æ€§
- **èµ„æºæ¸…ç†**ï¼šé’åŒ–å‰æ¸…ç†ç³»ç»Ÿèµ„æºï¼Œæ¿€æ´»åé‡æ–°åˆ›å»º
- **æŒä¹…åŒ–**ï¼šæœåŠ¡å™¨é‡å¯ä¸ä¸¢å¤±Sessionæ•°æ®

### 7.3 å®ç”¨æŠ€å·§æ€»ç»“


**ğŸ”§ å¼€å‘å»ºè®®**
```
è®¾è®¡åŸåˆ™ï¼š
âœ… å¯¹è±¡å®ç°Serializableå’ŒHttpSessionActivationListener
âœ… ä½¿ç”¨transientä¿®é¥°ä¸å¯åºåˆ—åŒ–å±æ€§
âœ… é’åŒ–å‰æ¸…ç†èµ„æºï¼Œæ¿€æ´»åé‡æ–°åˆ›å»º
âœ… æ·»åŠ serialVersionUIDé¿å…ç‰ˆæœ¬å†²çª

å¸¸è§é”™è¯¯ï¼š
âŒ å¿˜è®°å®ç°Serializableæ¥å£å¯¼è‡´é’åŒ–å¤±è´¥
âŒ ä¸æ¸…ç†æ•°æ®åº“è¿æ¥å¯¼è‡´èµ„æºæ³„éœ²  
âŒ ç¼“å­˜æ•°æ®æ²¡æœ‰é‡æ–°è®¡ç®—å¯¼è‡´æ•°æ®ä¸å‡†ç¡®
âŒ æ²¡æœ‰å¤„ç†æ¿€æ´»å¤±è´¥çš„å¼‚å¸¸æƒ…å†µ
```

**ğŸ¯ é…ç½®å»ºè®®**
```
æµ‹è¯•ç¯å¢ƒï¼šè®¾ç½®è¾ƒçŸ­çš„é’åŒ–æ—¶é—´ï¼ˆ1-2åˆ†é’Ÿï¼‰ä¾¿äºæµ‹è¯•
ç”Ÿäº§ç¯å¢ƒï¼šæ ¹æ®å®é™…è®¿é—®æ¨¡å¼é…ç½®åˆç†çš„é’åŒ–æ—¶é—´
é›†ç¾¤ç¯å¢ƒï¼šä½¿ç”¨æ•°æ®åº“æˆ–Redisç­‰å¤–éƒ¨å­˜å‚¨
å•æœºç¯å¢ƒï¼šä½¿ç”¨æ–‡ä»¶å­˜å‚¨å³å¯æ»¡è¶³éœ€æ±‚
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- é’åŒ–æ¿€æ´»åƒç”µè„‘ä¼‘çœ å”¤é†’ï¼ŒèŠ‚çœå†…å­˜æ”¯æŒé›†ç¾¤
- å¯¹è±¡è¦å®ç°ä¸¤ä¸ªæ¥å£ï¼šåºåˆ—åŒ–å’Œæ¿€æ´»ç›‘å¬
- é’åŒ–å‰æ¸…èµ„æºï¼Œæ¿€æ´»åé‡åˆ›å»º
- ç³»ç»Ÿè‡ªåŠ¨è§¦å‘ï¼Œå¼€å‘è€…åªéœ€å®ç°ç›‘å¬é€»è¾‘