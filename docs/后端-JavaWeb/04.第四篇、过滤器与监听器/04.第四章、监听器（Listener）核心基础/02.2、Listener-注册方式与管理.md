---
title: 2ã€Listener-æ³¨å†Œæ–¹å¼ä¸ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [Listeneræ³¨å†Œæ¦‚è¿°](#1-Listeneræ³¨å†Œæ¦‚è¿°)
2. [web.xmlé…ç½®æ³¨å†Œ](#2-webxmlé…ç½®æ³¨å†Œ)
3. [@WebListeneræ³¨è§£æ³¨å†Œ](#3-WebListeneræ³¨è§£æ³¨å†Œ)
4. [ServletContextåŠ¨æ€æ³¨å†Œ](#4-ServletContextåŠ¨æ€æ³¨å†Œ)
5. [Springå®¹å™¨ç®¡ç†](#5-Springå®¹å™¨ç®¡ç†)
6. [æ³¨å†Œé¡ºåºæ§åˆ¶](#6-æ³¨å†Œé¡ºåºæ§åˆ¶)
7. [å®¹å™¨è‡ªåŠ¨æ‰«ææœºåˆ¶](#7-å®¹å™¨è‡ªåŠ¨æ‰«ææœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Listeneræ³¨å†Œæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Listeneræ³¨å†Œ


**é€šä¿—ç†è§£**ï¼šå°±åƒåœ¨é…’åº—å‰å°ç•™ä¸‹ä½ çš„è”ç³»æ–¹å¼ï¼Œå½“æœ‰ç‰¹æ®Šæƒ…å†µå‘ç”Ÿæ—¶é…’åº—ä¼šé€šçŸ¥ä½ ä¸€æ ·ï¼ŒListeneræ³¨å†Œå°±æ˜¯å‘Šè¯‰Webå®¹å™¨ï¼š"å½“æŸäº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¯·é€šçŸ¥æˆ‘çš„ç›‘å¬å™¨"ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
Webå®¹å™¨å¯åŠ¨
     â†“
å‘ç°å¹¶æ³¨å†Œç›‘å¬å™¨
     â†“  
ç›‘å¬å™¨å¼€å§‹å·¥ä½œ
     â†“
äº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨è°ƒç”¨
```

### 1.2 æ³¨å†Œæ–¹å¼åˆ†ç±»


| æ³¨å†Œæ–¹å¼ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **çµæ´»æ€§** |
|---------|----------|-------------|-----------|
| ğŸ”§ **web.xmlé…ç½®** | `ä¼ ç»Ÿæ–¹å¼ï¼Œé…ç½®é›†ä¸­` | `ä¼ ç»Ÿé¡¹ç›®ï¼Œéœ€è¦ç»Ÿä¸€ç®¡ç†` | `ä½` |
| ğŸ·ï¸ **@WebListeneræ³¨è§£** | `ç®€å•ä¾¿æ·ï¼Œå°±è¿‘é…ç½®` | `ç°ä»£é¡¹ç›®ï¼Œå¿«é€Ÿå¼€å‘` | `ä¸­` |
| âš¡ **åŠ¨æ€æ³¨å†Œ** | `è¿è¡Œæ—¶æ³¨å†Œï¼Œçµæ´»æ§åˆ¶` | `å¤æ‚ä¸šåŠ¡ï¼Œæ¡ä»¶æ³¨å†Œ` | `é«˜` |
| ğŸŒ¸ **Springç®¡ç†** | `ä¾èµ–æ³¨å…¥ï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†` | `Springé¡¹ç›®ï¼Œä¼ä¸šçº§åº”ç”¨` | `æœ€é«˜` |

---

## 2. ğŸ“ web.xmlé…ç½®æ³¨å†Œ


### 2.1 åŸºæœ¬é…ç½®æ–¹å¼


**é…ç½®åŸç†**ï¼šé€šè¿‡XMLæ–‡ä»¶å‘Šè¯‰å®¹å™¨è¦æ³¨å†Œå“ªäº›ç›‘å¬å™¨ï¼Œå°±åƒå¡«å†™ä¸€å¼ "ç›‘å¬å™¨ç™»è®°è¡¨"ã€‚

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="3.1">
    <!-- é…ç½®ç›‘å¬å™¨ -->
    <listener>
        <listener-class>com.example.listener.SessionCountListener</listener-class>
    </listener>
    
    <!-- å¯ä»¥é…ç½®å¤šä¸ªç›‘å¬å™¨ -->
    <listener>
        <listener-class>com.example.listener.RequestTimingListener</listener-class>
    </listener>
</web-app>
```

### 2.2 é…ç½®è¦ç´ è¯¦è§£


**ğŸ”¸ æ ¸å¿ƒæ ‡ç­¾è¯´æ˜**ï¼š
- `<listener>` - ç›‘å¬å™¨çš„æ ¹æ ‡ç­¾ï¼Œè¡¨ç¤ºè¦æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨
- `<listener-class>` - ç›‘å¬å™¨çš„å®Œæ•´ç±»åï¼Œå¿…é¡»æ˜¯å®ç°äº†ç›¸åº”æ¥å£çš„ç±»

**ğŸ“ é…ç½®ä½ç½®**ï¼š
```
web.xmlæ–‡ä»¶ç»“æ„ï¼š
<web-app>
    <display-name>é¡¹ç›®åç§°</display-name>
    <context-param>å‚æ•°é…ç½®</context-param>
    
    <!-- ç›‘å¬å™¨é…ç½®é€šå¸¸æ”¾åœ¨è¿™é‡Œ -->
    <listener>...</listener>
    
    <filter>è¿‡æ»¤å™¨é…ç½®</filter>
    <servlet>Servleté…ç½®</servlet>
</web-app>
```

### 2.3 å®é™…åº”ç”¨ç¤ºä¾‹


**åˆ›å»ºç›‘å¬å™¨ç±»**ï¼š
```java
public class SessionCountListener implements HttpSessionListener {
    private int activeSessions = 0;
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        activeSessions++;
        System.out.println("æ–°ç”¨æˆ·ç™»å½•ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + activeSessions);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        activeSessions--;
        System.out.println("ç”¨æˆ·é€€å‡ºï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + activeSessions);
    }
}
```

**web.xmlé…ç½®**ï¼š
```xml
<listener>
    <listener-class>com.example.listener.SessionCountListener</listener-class>
</listener>
```

### 2.4 é…ç½®æ–¹å¼çš„ä¼˜ç¼ºç‚¹


**âœ… ä¼˜ç‚¹**ï¼š
- **é…ç½®é›†ä¸­**ï¼šæ‰€æœ‰ç›‘å¬å™¨é…ç½®åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†
- **ç¯å¢ƒéš”ç¦»**ï¼šä¸åŒç¯å¢ƒå¯ä»¥ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶
- **æ¸…æ™°å¯è§**ï¼šä¸€çœ¼å°±èƒ½çœ‹å‡ºé¡¹ç›®ä¸­æœ‰å“ªäº›ç›‘å¬å™¨

**âŒ ç¼ºç‚¹**ï¼š
- **é…ç½®ç¹ç**ï¼šæ¯ä¸ªç›‘å¬å™¨éƒ½éœ€è¦å†™XMLé…ç½®
- **å®¹æ˜“å‡ºé”™**ï¼šç±»åå†™é”™ä¸ä¼šåœ¨ç¼–è¯‘æ—¶å‘ç°
- **ä¸å¤Ÿçµæ´»**ï¼šæ— æ³•æ ¹æ®æ¡ä»¶åŠ¨æ€å†³å®šæ˜¯å¦æ³¨å†Œ

---

## 3. ğŸ·ï¸ @WebListeneræ³¨è§£æ³¨å†Œ


### 3.1 æ³¨è§£æ³¨å†ŒåŸç†


**é€šä¿—è§£é‡Š**ï¼šå°±åƒç»™ç›‘å¬å™¨è´´ä¸Šä¸€ä¸ªæ ‡ç­¾ï¼Œä¸Šé¢å†™ç€"æˆ‘æ˜¯ç›‘å¬å™¨"ï¼Œå®¹å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰«æè¿™äº›æ ‡ç­¾å¹¶æ³¨å†Œç›¸åº”çš„ç›‘å¬å™¨ã€‚

**åŸºæœ¬è¯­æ³•**ï¼š
```java
@WebListener
public class MyListener implements ServletContextListener {
    // ç›‘å¬å™¨å®ç°ä»£ç 
}
```

### 3.2 æ³¨è§£è¯¦ç»†ç”¨æ³•


**ğŸ¯ åŸºç¡€ä½¿ç”¨**ï¼š
```java
@WebListener("ç”¨æˆ·ä¼šè¯ç›‘å¬å™¨")
public class UserSessionListener implements HttpSessionListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        String sessionId = session.getId();
        System.out.println("åˆ›å»ºæ–°ä¼šè¯ï¼š" + sessionId);
        
        // è®°å½•ä¼šè¯åˆ›å»ºæ—¶é—´
        session.setAttribute("createTime", new Date());
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        Date createTime = (Date) session.getAttribute("createTime");
        System.out.println("ä¼šè¯é”€æ¯ï¼Œå­˜æ´»æ—¶é—´ï¼š" + 
            (System.currentTimeMillis() - createTime.getTime()) + "ms");
    }
}
```

### 3.3 æ³¨è§£å±æ€§è¯´æ˜


**@WebListeneræ³¨è§£å‚æ•°**ï¼š
```java
public @interface WebListener {
    String value() default "";      // æè¿°ä¿¡æ¯ï¼Œå¯é€‰
    String[] description() default {}; // è¯¦ç»†æè¿°ï¼Œå¯é€‰
}
```

**å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@WebListener(
    value = "åº”ç”¨ç¨‹åºå¯åŠ¨ç›‘å¬å™¨",
    description = {"ç›‘å¬åº”ç”¨å¯åŠ¨å’Œå…³é—­", "åˆå§‹åŒ–å…¨å±€èµ„æº"}
)
public class AppLifecycleListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("åº”ç”¨ç¨‹åºå¯åŠ¨äº†ï¼");
        // åˆå§‹åŒ–æ“ä½œï¼šæ•°æ®åº“è¿æ¥æ± ã€ç¼“å­˜ç­‰
        initializeResources(sce.getServletContext());
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("åº”ç”¨ç¨‹åºå…³é—­äº†ï¼");
        // æ¸…ç†æ“ä½œï¼šå…³é—­è¿æ¥ã€ä¿å­˜æ•°æ®ç­‰
        cleanupResources();
    }
}
```

### 3.4 æ³¨è§£æ‰«æé…ç½®


**å¯ç”¨æ³¨è§£æ‰«æ**ï¼š
```xml
<!-- web.xmlä¸­å¯ç”¨æ³¨è§£æ‰«æ -->
<web-app version="3.0" 
         metadata-complete="false">  <!-- å¿…é¡»è®¾ç½®ä¸ºfalse -->
    <!-- å…¶ä»–é…ç½® -->
</web-app>
```

**ğŸ“‹ æ‰«æé…ç½®è¯´æ˜**ï¼š
- `metadata-complete="false"` - å‘Šè¯‰å®¹å™¨éœ€è¦æ‰«ææ³¨è§£
- `version="3.0"` æˆ–æ›´é«˜ - æ”¯æŒæ³¨è§£çš„Servletç‰ˆæœ¬

### 3.5 æ³¨è§£æ–¹å¼ä¼˜ç¼ºç‚¹


**âœ… ä¼˜ç‚¹**ï¼š
- **ç®€å•æ–¹ä¾¿**ï¼šç›´æ¥åœ¨ç±»ä¸ŠåŠ æ³¨è§£å³å¯
- **å°±è¿‘åŸåˆ™**ï¼šé…ç½®å’Œä»£ç åœ¨ä¸€èµ·ï¼Œä¾¿äºç»´æŠ¤
- **ç¼–è¯‘æ£€æŸ¥**ï¼šIDEå¯ä»¥æ£€æŸ¥ç±»åå’ŒåŒ…åé”™è¯¯
- **ç°ä»£åŒ–**ï¼šç¬¦åˆç°ä»£Javaå¼€å‘ä¹ æƒ¯

**âŒ ç¼ºç‚¹**ï¼š
- **åˆ†æ•£é…ç½®**ï¼šç›‘å¬å™¨é…ç½®åˆ†æ•£åœ¨å„ä¸ªç±»ä¸­
- **ä¿®æ”¹ä¸ä¾¿**ï¼šä¿®æ”¹é…ç½®éœ€è¦é‡æ–°ç¼–è¯‘
- **ç¯å¢ƒå›ºå®š**ï¼šæ— æ³•é’ˆå¯¹ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®

---

## 4. âš¡ ServletContextåŠ¨æ€æ³¨å†Œ


### 4.1 åŠ¨æ€æ³¨å†Œæ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šå°±åƒåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶é›‡ä½£ä¸€ä¸ªä¿å®‰ï¼Œæ ¹æ®å®é™…æƒ…å†µå†³å®šæ˜¯å¦éœ€è¦è¿™ä¸ªç›‘å¬å™¨ï¼Œä»€ä¹ˆæ—¶å€™æ³¨å†Œå®ƒã€‚

**åŠ¨æ€æ³¨å†Œæ—¶æœº**ï¼š
```
åº”ç”¨å¯åŠ¨
   â†“
ServletContextListener.contextInitialized()è¢«è°ƒç”¨  
   â†“
åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åŠ¨æ€æ³¨å†Œå…¶ä»–ç›‘å¬å™¨
   â†“
åŠ¨æ€æ³¨å†Œçš„ç›‘å¬å™¨å¼€å§‹å·¥ä½œ
```

### 4.2 åŠ¨æ€æ³¨å†Œå®ç°


**ğŸ“ åŸºç¡€ç¤ºä¾‹**ï¼š
```java
@WebListener
public class DynamicRegistrationListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext context = sce.getServletContext();
        
        // æ ¹æ®é…ç½®å†³å®šæ˜¯å¦æ³¨å†Œç›‘å¬å™¨
        String enableSessionMonitor = context.getInitParameter("enableSessionMonitor");
        
        if ("true".equals(enableSessionMonitor)) {
            // åŠ¨æ€æ³¨å†Œä¼šè¯ç›‘å¬å™¨
            context.addListener(new SessionMonitorListener());
            System.out.println("åŠ¨æ€æ³¨å†Œäº†ä¼šè¯ç›‘å¬å™¨");
        }
        
        // ä¹Ÿå¯ä»¥é€šè¿‡ç±»åæ³¨å†Œ
        context.addListener("com.example.listener.RequestCountListener");
        System.out.println("åŠ¨æ€æ³¨å†Œäº†è¯·æ±‚è®¡æ•°ç›‘å¬å™¨");
    }
}
```

**åŠ¨æ€æ³¨å†Œçš„ç›‘å¬å™¨ç¤ºä¾‹**ï¼š
```java
public class SessionMonitorListener implements HttpSessionListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        // è®°å½•ä¼šè¯ä¿¡æ¯åˆ°æ•°æ®åº“æˆ–æ—¥å¿—
        logSessionInfo("CREATE", se.getSession().getId());
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        logSessionInfo("DESTROY", se.getSession().getId());
    }
    
    private void logSessionInfo(String action, String sessionId) {
        System.out.println(new Date() + " - " + action + " session: " + sessionId);
    }
}
```

### 4.3 åŠ¨æ€æ³¨å†Œçš„é«˜çº§ç”¨æ³•


**ğŸ”§ æ¡ä»¶æ³¨å†Œç¤ºä¾‹**ï¼š
```java
@WebListener
public class ConditionalRegistrationListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext context = sce.getServletContext();
        
        // æ ¹æ®ç¯å¢ƒå˜é‡å†³å®šæ³¨å†Œå“ªäº›ç›‘å¬å™¨
        String environment = System.getProperty("app.environment", "dev");
        
        switch (environment) {
            case "prod":
                // ç”Ÿäº§ç¯å¢ƒï¼šæ³¨å†Œæ€§èƒ½ç›‘æ§ç›‘å¬å™¨
                registerPerformanceMonitor(context);
                break;
            case "test":
                // æµ‹è¯•ç¯å¢ƒï¼šæ³¨å†Œæµ‹è¯•è¾…åŠ©ç›‘å¬å™¨
                registerTestHelper(context);
                break;
            case "dev":
                // å¼€å‘ç¯å¢ƒï¼šæ³¨å†Œè°ƒè¯•ç›‘å¬å™¨
                registerDebugMonitor(context);
                break;
        }
    }
    
    private void registerPerformanceMonitor(ServletContext context) {
        context.addListener(new PerformanceMonitorListener());
        System.out.println("æ³¨å†Œäº†æ€§èƒ½ç›‘æ§ç›‘å¬å™¨");
    }
    
    private void registerTestHelper(ServletContext context) {
        context.addListener(new TestHelperListener());
        System.out.println("æ³¨å†Œäº†æµ‹è¯•è¾…åŠ©ç›‘å¬å™¨");
    }
    
    private void registerDebugMonitor(ServletContext context) {
        context.addListener(new DebugMonitorListener());
        System.out.println("æ³¨å†Œäº†è°ƒè¯•ç›‘å¬å™¨");
    }
}
```

### 4.4 åŠ¨æ€æ³¨å†Œæ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦é™åˆ¶**ï¼š
```
æ—¶æœºé™åˆ¶ï¼š
- åªèƒ½åœ¨contextInitialized()æ–¹æ³•ä¸­åŠ¨æ€æ³¨å†Œ
- åº”ç”¨å¯åŠ¨å®Œæˆåæ— æ³•å†åŠ¨æ€æ³¨å†Œ

ç±»å‹é™åˆ¶ï¼š
- åªèƒ½æ³¨å†Œå®ç°äº†ç›‘å¬å™¨æ¥å£çš„ç±»
- ç±»å¿…é¡»æœ‰æ— å‚æ„é€ å‡½æ•°

ç”Ÿå‘½å‘¨æœŸï¼š
- åŠ¨æ€æ³¨å†Œçš„ç›‘å¬å™¨ä¸é™æ€æ³¨å†Œçš„å…·æœ‰ç›¸åŒç”Ÿå‘½å‘¨æœŸ
- åº”ç”¨å…³é—­æ—¶ä¼šè‡ªåŠ¨é”€æ¯
```

---

## 5. ğŸŒ¸ Springå®¹å™¨ç®¡ç†


### 5.1 Springç®¡ç†Listenerçš„ä¼˜åŠ¿


**é€šä¿—è§£é‡Š**ï¼šå°±åƒæŠŠç›‘å¬å™¨äº¤ç»™ä¸€ä¸ªä¸“ä¸šçš„ç®¡å®¶ï¼ˆSpringå®¹å™¨ï¼‰æ¥ç®¡ç†ï¼Œä¸ä»…å¸®ä½ åˆ›å»ºå’Œé”€æ¯ï¼Œè¿˜èƒ½æä¾›å„ç§è´´å¿ƒæœåŠ¡ï¼Œæ¯”å¦‚ä¾èµ–æ³¨å…¥ã€‚

**ğŸ¯ Springç®¡ç†çš„å¥½å¤„**ï¼š
- **ä¾èµ–æ³¨å…¥**ï¼šå¯ä»¥æ³¨å…¥å…¶ä»–Spring Bean
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šSpringè´Ÿè´£åˆ›å»ºå’Œé”€æ¯
- **AOPæ”¯æŒ**ï¼šå¯ä»¥ä½¿ç”¨åˆ‡é¢ç¼–ç¨‹
- **é…ç½®çµæ´»**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æˆ–æ³¨è§£æ§åˆ¶

### 5.2 Spring Bootä¸­çš„Listener


**ğŸš€ ä½¿ç”¨@Componentæ³¨è§£**ï¼š
```java
@Component
public class SpringManagedListener implements HttpSessionListener {
    
    // å¯ä»¥æ³¨å…¥å…¶ä»–Spring Bean
    @Autowired
    private UserService userService;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        String sessionId = se.getSession().getId();
        
        // ä½¿ç”¨æ³¨å…¥çš„æœåŠ¡
        System.out.println("æ–°ä¼šè¯åˆ›å»ºï¼š" + sessionId);
        
        // å­˜å‚¨åˆ°Redis
        redisTemplate.opsForSet().add("active_sessions", sessionId);
        
        // è®°å½•åˆ°æ•°æ®åº“
        userService.recordSessionCreation(sessionId);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        String sessionId = se.getSession().getId();
        
        System.out.println("ä¼šè¯é”€æ¯ï¼š" + sessionId);
        
        // ä»Redisä¸­ç§»é™¤
        redisTemplate.opsForSet().remove("active_sessions", sessionId);
        
        // æ›´æ–°æ•°æ®åº“è®°å½•
        userService.recordSessionDestruction(sessionId);
    }
}
```

### 5.3 æ³¨å†ŒSpringç®¡ç†çš„Listener


**ğŸ“ é…ç½®ç±»æ–¹å¼**ï¼š
```java
@Configuration
public class ListenerConfig {
    
    @Bean
    public ServletListenerRegistrationBean<SpringManagedListener> springManagedListener() {
        ServletListenerRegistrationBean<SpringManagedListener> registration = 
            new ServletListenerRegistrationBean<>();
        registration.setListener(new SpringManagedListener());
        registration.setOrder(1); // è®¾ç½®æ‰§è¡Œé¡ºåº
        return registration;
    }
}
```

**ğŸ”§ è‡ªåŠ¨æ³¨å†Œæ–¹å¼**ï¼š
```java
@Component
@WebListener
public class AutoRegisteredListener implements ServletRequestListener {
    
    @Autowired
    private LogService logService;
    
    @Override
    public void requestInitialized(ServletRequestEvent sre) {
        HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();
        String uri = request.getRequestURI();
        
        // ä½¿ç”¨Springç®¡ç†çš„æœåŠ¡è®°å½•è¯·æ±‚
        logService.logRequest(uri, request.getRemoteAddr());
    }
    
    @Override
    public void requestDestroyed(ServletRequestEvent sre) {
        // è¯·æ±‚ç»“æŸå¤„ç†
        logService.logRequestEnd();
    }
}
```

### 5.4 Spring Booté…ç½®ç¤ºä¾‹


**application.ymlé…ç½®**ï¼š
```yaml
# è‡ªå®šä¹‰ç›‘å¬å™¨é…ç½®
app:
  listener:
    session-monitor: true
    request-log: true
    performance-monitor: false
```

**æ¡ä»¶åŒ–æ³¨å†Œ**ï¼š
```java
@Component
@ConditionalOnProperty(name = "app.listener.session-monitor", havingValue = "true")
public class ConditionalSessionListener implements HttpSessionListener {
    
    private final Logger logger = LoggerFactory.getLogger(ConditionalSessionListener.class);
    
    @Value("${app.name:MyApp}")
    private String appName;
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        logger.info("[{}] æ–°ä¼šè¯åˆ›å»º: {}", appName, se.getSession().getId());
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        logger.info("[{}] ä¼šè¯é”€æ¯: {}", appName, se.getSession().getId());
    }
}
```

---

## 6. ğŸ”¢ æ³¨å†Œé¡ºåºæ§åˆ¶


### 6.1 ä¸ºä»€ä¹ˆè¦æ§åˆ¶é¡ºåº


**å®é™…åœºæ™¯**ï¼š
```
æƒ³è±¡ä¸€ä¸ªé…’åº—çš„æœåŠ¡æµç¨‹ï¼š
1. é¦–å…ˆï¼Œä¿å®‰è¦å°±ä½ï¼ˆå®‰å…¨ç›‘å¬å™¨ï¼‰
2. ç„¶åï¼Œå‰å°è¦å‡†å¤‡å¥½ï¼ˆè¯·æ±‚å¤„ç†ç›‘å¬å™¨ï¼‰  
3. æœ€åï¼Œæ¸…æ´å·¥å¼€å§‹å·¥ä½œï¼ˆæ—¥å¿—æ¸…ç†ç›‘å¬å™¨ï¼‰

å¦‚æœé¡ºåºæé”™äº†ï¼Œå¯èƒ½å‰å°è¿˜æ²¡å‡†å¤‡å¥½ï¼Œå®¢äººå°±æ¥äº†ï¼
```

**é¡ºåºå½±å“çš„ç¤ºä¾‹**ï¼š
```java
// ç›‘å¬å™¨Aï¼šåˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
public class DatabaseInitListener implements ServletContextListener {
    public void contextInitialized(ServletContextEvent sce) {
        // åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
        DatabasePool.init();
    }
}

// ç›‘å¬å™¨Bï¼šåŠ è½½ç”¨æˆ·æ•°æ®ï¼ˆä¾èµ–æ•°æ®åº“è¿æ¥æ± ï¼‰
public class UserDataLoader implements ServletContextListener {
    public void contextInitialized(ServletContextEvent sce) {
        // è¿™é‡Œéœ€è¦ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± 
        // å¦‚æœDatabaseInitListenerè¿˜æ²¡æ‰§è¡Œï¼Œè¿™é‡Œå°±ä¼šå‡ºé”™ï¼
        loadUserData();
    }
}
```

### 6.2 web.xmlä¸­çš„é¡ºåºæ§åˆ¶


**ğŸ“‹ é¡ºåºè§„åˆ™**ï¼š
åœ¨web.xmlä¸­ï¼Œç›‘å¬å™¨æŒ‰ç…§é…ç½®çš„å…ˆåé¡ºåºæ‰§è¡Œï¼š

```xml
<web-app>
    <!-- ç¬¬ä¸€ä¸ªæ‰§è¡Œ -->
    <listener>
        <listener-class>com.example.listener.DatabaseInitListener</listener-class>
    </listener>
    
    <!-- ç¬¬äºŒä¸ªæ‰§è¡Œ -->  
    <listener>
        <listener-class>com.example.listener.CacheInitListener</listener-class>
    </listener>
    
    <!-- ç¬¬ä¸‰ä¸ªæ‰§è¡Œ -->
    <listener>
        <listener-class>com.example.listener.UserDataLoader</listener-class>
    </listener>
</web-app>
```

### 6.3 æ³¨è§£æ–¹å¼çš„é¡ºåºæ§åˆ¶


**âŒ æ³¨è§£æ–¹å¼çš„é™åˆ¶**ï¼š
```java
// @WebListeneræ³¨è§£æ— æ³•ç›´æ¥æ§åˆ¶æ‰§è¡Œé¡ºåºï¼
@WebListener
public class ListenerA implements ServletContextListener { }

@WebListener  
public class ListenerB implements ServletContextListener { }

// æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œå–å†³äºç±»åŠ è½½é¡ºåº
```

**âœ… è§£å†³æ–¹æ¡ˆ - ä½¿ç”¨Orderæ¥å£**ï¼š
```java
@WebListener
public class OrderedListenerA implements ServletContextListener, Ordered {
    
    @Override
    public int getOrder() {
        return 1; // æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜
    }
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("OrderedListenerA æ‰§è¡Œ - ä¼˜å…ˆçº§1");
    }
}

@WebListener
public class OrderedListenerB implements ServletContextListener, Ordered {
    
    @Override
    public int getOrder() {
        return 2; // æ¯”ListenerAæ™šæ‰§è¡Œ
    }
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("OrderedListenerB æ‰§è¡Œ - ä¼˜å…ˆçº§2");
    }
}
```

### 6.4 Spring Bootä¸­çš„é¡ºåºæ§åˆ¶


**ğŸ¯ ä½¿ç”¨@Orderæ³¨è§£**ï¼š
```java
@Component
@Order(1)
public class HighPriorityListener implements ApplicationListener<ContextRefreshedEvent> {
    
    @Override
    public void onApplicationEvent(ContextRefreshedEvent event) {
        System.out.println("é«˜ä¼˜å…ˆçº§ç›‘å¬å™¨æ‰§è¡Œ");
    }
}

@Component
@Order(2)
public class LowPriorityListener implements ApplicationListener<ContextRefreshedEvent> {
    
    @Override
    public void onApplicationEvent(ContextRefreshedEvent event) {
        System.out.println("ä½ä¼˜å…ˆçº§ç›‘å¬å™¨æ‰§è¡Œ");
    }
}
```

**ğŸ“ ServletListenerRegistrationBeanæ–¹å¼**ï¼š
```java
@Configuration
public class ListenerOrderConfig {
    
    @Bean
    public ServletListenerRegistrationBean<DatabaseInitListener> databaseListener() {
        ServletListenerRegistrationBean<DatabaseInitListener> bean = 
            new ServletListenerRegistrationBean<>();
        bean.setListener(new DatabaseInitListener());
        bean.setOrder(1); // æœ€é«˜ä¼˜å…ˆçº§
        return bean;
    }
    
    @Bean
    public ServletListenerRegistrationBean<CacheInitListener> cacheListener() {
        ServletListenerRegistrationBean<CacheInitListener> bean = 
            new ServletListenerRegistrationBean<>();
        bean.setListener(new CacheInitListener());
        bean.setOrder(2); // ç¬¬äºŒä¼˜å…ˆçº§
        return bean;
    }
}
```

---

## 7. ğŸ” å®¹å™¨è‡ªåŠ¨æ‰«ææœºåˆ¶


### 7.1 æ‰«ææœºåˆ¶åŸç†


**é€šä¿—è§£é‡Š**ï¼šå°±åƒæµ·å…³æ£€æŸ¥ï¼Œå®¹å™¨å¯åŠ¨æ—¶ä¼š"æ‰«æ"æ•´ä¸ªé¡¹ç›®ï¼Œå¯»æ‰¾æ‰€æœ‰æ ‡è®°äº†`@WebListener`çš„ç±»ï¼Œç„¶åè‡ªåŠ¨æ³¨å†Œå®ƒä»¬ã€‚

**æ‰«æè¿‡ç¨‹å›¾ç¤º**ï¼š
```
å®¹å™¨å¯åŠ¨
    â†“
æ‰«æç±»è·¯å¾„
    â†“
å¯»æ‰¾@WebListeneræ³¨è§£
    â†“
æ£€æŸ¥æ˜¯å¦å®ç°ç›‘å¬å™¨æ¥å£
    â†“
è‡ªåŠ¨æ³¨å†Œå¹¶å®ä¾‹åŒ–
    â†“
ç›‘å¬å™¨å¼€å§‹å·¥ä½œ
```

### 7.2 æ‰«æé…ç½®è¦æ±‚


**ğŸ“‹ å¿…è¦é…ç½®**ï¼š
```xml
<!-- web.xmlé…ç½® -->
<web-app version="3.0"
         metadata-complete="false"> <!-- å…³é”®ï¼šå¿…é¡»ä¸ºfalse -->
    
    <display-name>MyWebApp</display-name>
    
    <!-- å…¶ä»–é…ç½® -->
</web-app>
```

**é…ç½®è¯´æ˜**ï¼š
- `version="3.0"` æˆ–æ›´é«˜ç‰ˆæœ¬ - æ”¯æŒæ³¨è§£æ‰«æ
- `metadata-complete="false"` - å‘Šè¯‰å®¹å™¨éœ€è¦æ‰«ææ³¨è§£
- å¦‚æœè®¾ç½®ä¸º`true`ï¼Œå®¹å™¨åªè¯»å–web.xmlï¼Œä¸æ‰«ææ³¨è§£

### 7.3 æ‰«æèŒƒå›´æ§åˆ¶


**ğŸ¯ é»˜è®¤æ‰«æèŒƒå›´**ï¼š
```
é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¼šæ‰«æï¼š
- WEB-INF/classes/ ç›®å½•ä¸‹çš„æ‰€æœ‰classæ–‡ä»¶
- WEB-INF/lib/ ç›®å½•ä¸‹jaråŒ…ä¸­çš„classæ–‡ä»¶
- é¡¹ç›®ä¾èµ–çš„ç¬¬ä¸‰æ–¹jaråŒ…
```

**è‡ªå®šä¹‰æ‰«æèŒƒå›´**ï¼š
```xml
<!-- é€šè¿‡FragmentæŒ‡å®šæ‰«æç‰¹å®šçš„jaråŒ… -->
<web-fragment>
    <name>MyFragment</name>
    <!-- åªæ‰«æè¿™ä¸ªfragmentä¸­çš„æ³¨è§£ -->
</web-fragment>
```

### 7.4 æ‰«ææ€§èƒ½ä¼˜åŒ–


**âš¡ ä¼˜åŒ–ç­–ç•¥**ï¼š
```java
// 1. ä½¿ç”¨åŒ…è·¯å¾„é™åˆ¶æ‰«æèŒƒå›´
@ComponentScan(basePackages = "com.example.listeners")
public class ListenerConfig {
}

// 2. ä½¿ç”¨æ¡ä»¶æ³¨è§£é¿å…ä¸å¿…è¦çš„æ‰«æ
@ConditionalOnProperty("app.feature.monitoring")
@WebListener
public class OptionalMonitoringListener implements ServletContextListener {
    // åªæœ‰å½“é…ç½®å¯ç”¨æ—¶æ‰ä¼šè¢«æ‰«æå’Œæ³¨å†Œ
}
```

**ğŸ“Š æ‰«ææ€§èƒ½å¯¹æ¯”**ï¼š

| æ‰«ææ–¹å¼ | **å¯åŠ¨æ—¶é—´** | **å†…å­˜å ç”¨** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| ğŸŒ **å…¨é¡¹ç›®æ‰«æ** | `è¾ƒæ…¢` | `è¾ƒé«˜` | `å°å‹é¡¹ç›®ï¼Œç›‘å¬å™¨ä¸å¤š` |
| ğŸ“¦ **åŒ…è·¯å¾„é™åˆ¶** | `ä¸­ç­‰` | `ä¸­ç­‰` | `ä¸­å‹é¡¹ç›®ï¼Œæ¨¡å—åŒ–å¼€å‘` |
| ğŸ¯ **æ¡ä»¶æ‰«æ** | `è¾ƒå¿«` | `è¾ƒä½` | `å¤§å‹é¡¹ç›®ï¼ŒæŒ‰éœ€åŠ è½½` |

### 7.5 æ‰«ææ•…éšœæ’é™¤


**ğŸ”§ å¸¸è§é—®é¢˜åŠè§£å†³**ï¼š

**é—®é¢˜1ï¼šç›‘å¬å™¨æ²¡æœ‰è¢«æ‰«æåˆ°**
```java
// æ£€æŸ¥é¡¹ç›®ç»“æ„
src/
  main/
    java/
      com/example/listener/
        MyListener.java  // ç¡®ä¿åœ¨æ­£ç¡®çš„åŒ…è·¯å¾„ä¸‹
    
// æ£€æŸ¥æ³¨è§£
@WebListener  // ç¡®ä¿æ³¨è§£æ‹¼å†™æ­£ç¡®
public class MyListener implements ServletContextListener {
    // ç¡®ä¿å®ç°äº†æ­£ç¡®çš„æ¥å£
}
```

**é—®é¢˜2ï¼šé‡å¤æ³¨å†Œ**
```xml
<!-- é¿å…åŒæ—¶ä½¿ç”¨å¤šç§æ³¨å†Œæ–¹å¼ -->
<!-- ä¸è¦åœ¨web.xmlä¸­é…ç½®å·²ç»ä½¿ç”¨@WebListenerçš„ç±» -->
```

**é—®é¢˜3ï¼šå¯åŠ¨å¼‚å¸¸**
```java
// æ£€æŸ¥ç›‘å¬å™¨ç±»æ˜¯å¦æœ‰æ— å‚æ„é€ å‡½æ•°
public class MyListener implements ServletContextListener {
    
    // âœ… æ­£ç¡®ï¼šæœ‰æ— å‚æ„é€ å‡½æ•°
    public MyListener() {
    }
    
    // âŒ é”™è¯¯ï¼šåªæœ‰æœ‰å‚æ„é€ å‡½æ•°
    // public MyListener(String param) {
    // }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ³¨å†Œæ–¹å¼ï¼šweb.xmlé…ç½®ã€@WebListeneræ³¨è§£ã€åŠ¨æ€æ³¨å†Œã€Springç®¡ç†
ğŸ”¸ é€‰æ‹©åŸåˆ™ï¼šæ ¹æ®é¡¹ç›®ç±»å‹å’Œéœ€æ±‚é€‰æ‹©åˆé€‚çš„æ³¨å†Œæ–¹å¼
ğŸ”¸ é¡ºåºæ§åˆ¶ï¼šç†è§£ç›‘å¬å™¨æ‰§è¡Œé¡ºåºçš„é‡è¦æ€§å’Œæ§åˆ¶æ–¹æ³•
ğŸ”¸ æ‰«ææœºåˆ¶ï¼šå®¹å™¨å¦‚ä½•å‘ç°å’Œæ³¨å†Œæ³¨è§£æ ‡è®°çš„ç›‘å¬å™¨
ğŸ”¸ æœ€ä½³å®è·µï¼šåœ¨å®é™…é¡¹ç›®ä¸­å¦‚ä½•åˆç†ä½¿ç”¨å„ç§æ³¨å†Œæ–¹å¼
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ³¨å†Œæ–¹å¼çš„é€‰æ‹©ç­–ç•¥**
```
ä¼ ç»Ÿé¡¹ç›® â†’ web.xmlé…ç½®
- é…ç½®é›†ä¸­ï¼Œä¾¿äºç®¡ç†
- é€‚åˆå›¢é˜Ÿå¼€å‘ï¼Œç»Ÿä¸€è§„èŒƒ

ç°ä»£é¡¹ç›® â†’ @WebListeneræ³¨è§£  
- å¼€å‘ä¾¿æ·ï¼Œå°±è¿‘é…ç½®
- é€‚åˆå¿«é€Ÿå¼€å‘ï¼Œä¸ªäººé¡¹ç›®

å¤æ‚é¡¹ç›® â†’ åŠ¨æ€æ³¨å†Œ
- çµæ´»æ§åˆ¶ï¼ŒæŒ‰éœ€æ³¨å†Œ
- é€‚åˆæ¡ä»¶å¤æ‚ï¼Œå¤šç¯å¢ƒéƒ¨ç½²

Springé¡¹ç›® â†’ Springå®¹å™¨ç®¡ç†
- ä¾èµ–æ³¨å…¥ï¼ŒåŠŸèƒ½å¼ºå¤§
- é€‚åˆä¼ä¸šçº§åº”ç”¨ï¼Œå¤æ‚ä¸šåŠ¡
```

**ğŸ”¹ é¡ºåºæ§åˆ¶çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦æ§åˆ¶é¡ºåºï¼š
- ç›‘å¬å™¨ä¹‹é—´å¯èƒ½æœ‰ä¾èµ–å…³ç³»
- åˆå§‹åŒ–èµ„æºéœ€è¦æŒ‰ç‰¹å®šé¡ºåº
- é¿å…ç©ºæŒ‡é’ˆå’Œåˆå§‹åŒ–å¼‚å¸¸

å¦‚ä½•æ§åˆ¶é¡ºåºï¼š
- web.xmlï¼šé…ç½®é¡ºåºå†³å®šæ‰§è¡Œé¡ºåº
- æ³¨è§£ï¼šä½¿ç”¨@Orderæˆ–Orderedæ¥å£
- Springï¼šServletListenerRegistrationBeanè®¾ç½®order
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æœ€ä½³å®è·µå»ºè®®**ï¼š

1. **å•ä¸€é¡¹ç›®å†…ç»Ÿä¸€æ³¨å†Œæ–¹å¼**
   ```java
   // âœ… å¥½çš„åšæ³•ï¼šç»Ÿä¸€ä½¿ç”¨æ³¨è§£
   @WebListener
   public class ListenerA implements ServletContextListener {}
   
   @WebListener  
   public class ListenerB implements HttpSessionListener {}
   
   // âŒ é¿å…æ··ç”¨
   // ä¸€ä¸ªç”¨æ³¨è§£ï¼Œä¸€ä¸ªç”¨web.xmlé…ç½®
   ```

2. **åˆç†è®¾ç½®æ‰§è¡Œé¡ºåº**
   ```java
   // åŸºç¡€è®¾æ–½ç›‘å¬å™¨ï¼šä¼˜å…ˆçº§æœ€é«˜
   @Order(1)
   public class DatabaseInitListener {}
   
   // ä¸šåŠ¡ç›‘å¬å™¨ï¼šä¸­ç­‰ä¼˜å…ˆçº§
   @Order(50)
   public class BusinessLogicListener {}
   
   // æ¸…ç†ç›‘å¬å™¨ï¼šä¼˜å…ˆçº§æœ€ä½
   @Order(100)  
   public class CleanupListener {}
   ```

3. **ç¯å¢ƒç›¸å…³çš„æ¡ä»¶æ³¨å†Œ**
   ```java
   // å¼€å‘ç¯å¢ƒæ‰æ³¨å†Œè°ƒè¯•ç›‘å¬å™¨
   @ConditionalOnProperty(name = "spring.profiles.active", havingValue = "dev")
   @WebListener
   public class DebugListener implements ServletRequestListener {}
   ```

### 8.4 å¸¸è§é”™è¯¯é¿å…


**âŒ å¸¸è§é”™è¯¯**ï¼š
- åŒæ—¶ä½¿ç”¨å¤šç§æ³¨å†Œæ–¹å¼å¯¼è‡´é‡å¤æ³¨å†Œ
- å¿½ç•¥ç›‘å¬å™¨æ‰§è¡Œé¡ºåºå¯¼è‡´ä¾èµ–é—®é¢˜  
- web.xmlä¸­metadata-completeè®¾ç½®é”™è¯¯å¯¼è‡´æ‰«æå¤±è´¥
- ç›‘å¬å™¨ç±»æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°å¯¼è‡´å®ä¾‹åŒ–å¤±è´¥

**âœ… æ­£ç¡®åšæ³•**ï¼š
- é€‰æ‹©ä¸€ç§ä¸»è¦çš„æ³¨å†Œæ–¹å¼ï¼Œç‰¹æ®Šæƒ…å†µæ‰æ··ç”¨
- æ˜ç¡®ç›‘å¬å™¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œåˆç†è®¾ç½®é¡ºåº
- æ­£ç¡®é…ç½®web.xmlçš„æ‰«æå‚æ•°
- ç¡®ä¿ç›‘å¬å™¨ç±»ç¬¦åˆJavaBeanè§„èŒƒ

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ³¨å†Œç›‘å¬å™¨æœ‰å››ç§æ–¹å¼ï¼Œé€‰æ‹©åˆé€‚æœ€é‡è¦
- æ‰§è¡Œé¡ºåºå¾ˆå…³é”®ï¼Œä¾èµ–å…³ç³»è¦ç†æ¸…
- æ‰«æé…ç½®è¦æ­£ç¡®ï¼Œmetadata-completeåˆ«å¿˜è®°
- Springç®¡ç†æœ€å¼ºå¤§ï¼Œä¾èµ–æ³¨å…¥åŠŸèƒ½å¤š