---
title: 1ã€Listener-ServletContextå±æ€§ç›‘å¬
---
## ğŸ“š ç›®å½•

1. [ServletContextå±æ€§ç›‘å¬å™¨æ¦‚è¿°](#1-ServletContextå±æ€§ç›‘å¬å™¨æ¦‚è¿°)
2. [ServletContextAttributeListeneræ¥å£è¯¦è§£](#2-ServletContextAttributeListeneræ¥å£è¯¦è§£)
3. [å±æ€§å˜åŒ–ç›‘å¬çš„ä¸‰å¤§åœºæ™¯](#3-å±æ€§å˜åŒ–ç›‘å¬çš„ä¸‰å¤§åœºæ™¯)
4. [å…¨å±€é…ç½®ç›‘æ§å®è·µ](#4-å…¨å±€é…ç½®ç›‘æ§å®è·µ)
5. [ç¼“å­˜æ•°æ®ç®¡ç†åº”ç”¨](#5-ç¼“å­˜æ•°æ®ç®¡ç†åº”ç”¨)
6. [ç³»ç»ŸçŠ¶æ€è·Ÿè¸ªæœºåˆ¶](#6-ç³»ç»ŸçŠ¶æ€è·Ÿè¸ªæœºåˆ¶)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ServletContextå±æ€§ç›‘å¬å™¨æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ServletContextå±æ€§ç›‘å¬å™¨


**é€šä¿—ç†è§£**ï¼šæŠŠServletContextæƒ³è±¡æˆä¸€ä¸ª**å…¨å±€å…±äº«çš„å‚¨ç‰©æŸœ**ï¼Œå±æ€§ç›‘å¬å™¨å°±åƒæ˜¯**é—¨å«å¤§å”**ï¼Œä¸“é—¨è´Ÿè´£ç›‘æ§è¿™ä¸ªå‚¨ç‰©æŸœé‡Œä¸œè¥¿çš„å˜åŒ–æƒ…å†µã€‚

```
ç°å®åœºæ™¯æ¯”å–»ï¼š
å‚¨ç‰©æŸœï¼ˆServletContextï¼‰é‡Œçš„ç‰©å“å˜åŒ–ï¼š
- æœ‰äººæ”¾è¿›æ–°ä¸œè¥¿ â†’ attributeAddedï¼ˆå±æ€§æ·»åŠ ï¼‰
- æœ‰äººå–èµ°ä¸œè¥¿   â†’ attributeRemovedï¼ˆå±æ€§ç§»é™¤ï¼‰  
- æœ‰äººæ¢æ‰ä¸œè¥¿   â†’ attributeReplacedï¼ˆå±æ€§æ›¿æ¢ï¼‰

é—¨å«å¤§å”ï¼ˆç›‘å¬å™¨ï¼‰ä¼šè®°å½•ä¸‹æ‰€æœ‰è¿™äº›å˜åŒ–ï¼
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å±æ€§ç›‘å¬å™¨


**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
- **çŠ¶æ€è·Ÿè¸ª**ï¼šå®æ—¶æŒæ¡åº”ç”¨å…¨å±€æ•°æ®å˜åŒ–
- **èµ„æºç®¡ç†**ï¼šç›‘æ§ç¼“å­˜æ•°æ®çš„å¢åˆ æ”¹
- **æ—¥å¿—å®¡è®¡**ï¼šè®°å½•é‡è¦é…ç½®çš„ä¿®æ”¹å†å²
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåŸºäºæ•°æ®å˜åŒ–è§¦å‘ç›¸åº”æ“ä½œ

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
```
ç”µå•†ç½‘ç«™çš„å…¨å±€é…ç½®ç›‘æ§ï¼š
- å•†å“åˆ†ç±»æ•°æ®æ›´æ–° â†’ æ¸…ç†ç›¸å…³ç¼“å­˜
- ä¿ƒé”€æ´»åŠ¨é…ç½®ä¿®æ”¹ â†’ é€šçŸ¥å‰ç«¯åˆ·æ–°é¡µé¢
- ç³»ç»Ÿç»´æŠ¤çŠ¶æ€æ”¹å˜ â†’ è®°å½•æ“ä½œæ—¥å¿—
```

### 1.3 ç›‘å¬å™¨çš„å·¥ä½œåŸç†


**ğŸ”„ å·¥ä½œæµç¨‹å›¾**
```
Webåº”ç”¨å¯åŠ¨
    â†“
ç›‘å¬å™¨è‡ªåŠ¨æ³¨å†Œ
    â†“
ServletContextä¸­çš„å±æ€§å‘ç”Ÿå˜åŒ–
    â†“
ç›‘å¬å™¨æ–¹æ³•è¢«è‡ªåŠ¨è°ƒç”¨
    â†“
æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘
    â†“
è®°å½•æ—¥å¿—/æ›´æ–°ç¼“å­˜/å‘é€é€šçŸ¥
```

---

## 2. ğŸ“‹ ServletContextAttributeListeneræ¥å£è¯¦è§£


### 2.1 æ¥å£åŸºæœ¬ç»“æ„


**ğŸ”¸ æ¥å£å®šä¹‰**
```java
public interface ServletContextAttributeListener extends EventListener {
    // å±æ€§æ·»åŠ æ—¶è°ƒç”¨
    void attributeAdded(ServletContextAttributeEvent event);
    
    // å±æ€§ç§»é™¤æ—¶è°ƒç”¨
    void attributeRemoved(ServletContextAttributeEvent event);
    
    // å±æ€§æ›¿æ¢æ—¶è°ƒç”¨
    void attributeReplaced(ServletContextAttributeEvent event);
}
```

**ğŸ’¡ æ¥å£ç‰¹ç‚¹**
- **è‡ªåŠ¨è§¦å‘**ï¼šä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼Œå®¹å™¨è‡ªåŠ¨æ‰§è¡Œ
- **äº‹ä»¶é©±åŠ¨**ï¼šåŸºäºå±æ€§å˜åŒ–äº‹ä»¶è¿›è¡Œå“åº”
- **å…¨è¦†ç›–**ï¼šç›‘å¬æ‰€æœ‰å±æ€§çš„å¢åˆ æ”¹æ“ä½œ

### 2.2 ServletContextAttributeEventäº‹ä»¶å¯¹è±¡


**ğŸ”¸ äº‹ä»¶å¯¹è±¡çš„ä½œç”¨**
```java
// äº‹ä»¶å¯¹è±¡æä¾›çš„å…³é”®ä¿¡æ¯
ServletContextAttributeEvent event = ...;

String name = event.getName();        // è·å–å±æ€§åç§°
Object value = event.getValue();      // è·å–å±æ€§å€¼
ServletContext context = event.getServletContext(); // è·å–ä¸Šä¸‹æ–‡
```

**ğŸ“Š äº‹ä»¶å¯¹è±¡ä¿¡æ¯å¯¹æ¯”**

| æ–¹æ³• | **è¿”å›å†…å®¹** | **åº”ç”¨åœºæ™¯** |
|------|-------------|-------------|
| `getName()` | **å±æ€§åç§°** | `æ—¥å¿—è®°å½•ã€æ¡ä»¶åˆ¤æ–­` |
| `getValue()` | **å±æ€§å€¼** | `æ•°æ®å¤„ç†ã€çŠ¶æ€åˆ¤æ–­` |
| `getServletContext()` | **ä¸Šä¸‹æ–‡å¯¹è±¡** | `è·å–å…¶ä»–å±æ€§ã€æ“ä½œå…±äº«æ•°æ®` |

### 2.3 åŸºç¡€ç›‘å¬å™¨å®ç°


```java
@WebListener
public class ContextAttributeMonitor implements ServletContextAttributeListener {
    
    private static final Logger logger = LoggerFactory.getLogger(ContextAttributeMonitor.class);
    
    @Override
    public void attributeAdded(ServletContextAttributeEvent event) {
        String name = event.getName();
        Object value = event.getValue();
        logger.info("âœ… æ–°å¢å±æ€§ï¼š{} = {}", name, value);
    }
    
    @Override
    public void attributeRemoved(ServletContextAttributeEvent event) {
        String name = event.getName();
        Object value = event.getValue();
        logger.info("âŒ åˆ é™¤å±æ€§ï¼š{} = {}", name, value);
    }
    
    @Override
    public void attributeReplaced(ServletContextAttributeEvent event) {
        String name = event.getName();
        Object oldValue = event.getValue(); // æ³¨æ„ï¼šè¿™é‡Œæ˜¯æ—§å€¼
        Object newValue = event.getServletContext().getAttribute(name);
        logger.info("ğŸ”„ æ›¿æ¢å±æ€§ï¼š{} ä» {} æ”¹ä¸º {}", name, oldValue, newValue);
    }
}
```

---

## 3. ğŸ” å±æ€§å˜åŒ–ç›‘å¬çš„ä¸‰å¤§åœºæ™¯


### 3.1 attributeAdded - å±æ€§æ·»åŠ åœºæ™¯


**ğŸ”¸ è§¦å‘æ—¶æœº**
- ä½¿ç”¨`setAttribute()`é¦–æ¬¡è®¾ç½®å±æ€§
- å±æ€§åä¹‹å‰ä¸å­˜åœ¨äºServletContextä¸­

**ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯**
```java
// ç¤ºä¾‹ï¼šç›‘æ§ç³»ç»Ÿé…ç½®çš„æ·»åŠ 
@Override
public void attributeAdded(ServletContextAttributeEvent event) {
    String name = event.getName();
    
    if ("SYSTEM_CONFIG".equals(name)) {
        logger.info("ç³»ç»Ÿé…ç½®å·²åŠ è½½å®Œæˆ");
        // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘å…¶ä»–åˆå§‹åŒ–æ“ä½œ
        initializeSystemModules();
    }
    
    if (name.startsWith("CACHE_")) {
        logger.info("æ–°çš„ç¼“å­˜æ•°æ®å·²åˆ›å»ºï¼š{}", name);
        updateCacheStats();
    }
}
```

**ğŸ¯ å®é™…è¿ç”¨**
- **é…ç½®åŠ è½½å®Œæˆé€šçŸ¥**ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é…ç½®æ–‡ä»¶åŠ è½½å®Œæ¯•
- **ç¼“å­˜åˆå§‹åŒ–è·Ÿè¸ª**ï¼šè®°å½•æ–°ç¼“å­˜åŒºåŸŸçš„åˆ›å»º
- **æ¨¡å—æ³¨å†Œç›‘æ§**ï¼šç›‘æ§æ–°åŠŸèƒ½æ¨¡å—çš„æ³¨å†Œ

### 3.2 attributeRemoved - å±æ€§ç§»é™¤åœºæ™¯


**ğŸ”¸ è§¦å‘æ—¶æœº**
- ä½¿ç”¨`removeAttribute()`åˆ é™¤å±æ€§
- å±æ€§ç¡®å®å­˜åœ¨äºServletContextä¸­

**ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯**
```java
@Override
public void attributeRemoved(ServletContextAttributeEvent event) {
    String name = event.getName();
    Object value = event.getValue();
    
    if (name.startsWith("USER_SESSION_")) {
        logger.info("ç”¨æˆ·ä¼šè¯æ•°æ®è¢«æ¸…ç†ï¼š{}", name);
        // è®°å½•ç”¨æˆ·é€€å‡ºè¡Œä¸º
        recordUserLogout(name, value);
    }
    
    if ("MAINTENANCE_MODE".equals(name)) {
        logger.info("ç³»ç»Ÿç»´æŠ¤æ¨¡å¼å·²å…³é—­");
        // é€šçŸ¥æ‰€æœ‰æ¨¡å—æ¢å¤æ­£å¸¸æœåŠ¡
        notifyMaintenanceEnd();
    }
}
```

**ğŸ¯ å®é™…è¿ç”¨**
- **èµ„æºæ¸…ç†è·Ÿè¸ª**ï¼šç›‘æ§ä¸´æ—¶æ•°æ®çš„æ¸…ç†
- **ä¼šè¯ç®¡ç†**ï¼šè·Ÿè¸ªç”¨æˆ·ä¼šè¯çš„é”€æ¯
- **ç³»ç»ŸçŠ¶æ€å˜æ›´**ï¼šç›‘æ§ç»´æŠ¤æ¨¡å¼ç­‰çŠ¶æ€çš„å˜åŒ–

### 3.3 attributeReplaced - å±æ€§æ›¿æ¢åœºæ™¯


**ğŸ”¸ è§¦å‘æ—¶æœº**
- ä½¿ç”¨`setAttribute()`æ›´æ–°å·²å­˜åœ¨çš„å±æ€§
- å±æ€§åå·²ç»å­˜åœ¨ï¼Œä½†å€¼å‘ç”Ÿäº†å˜åŒ–

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
```java
@Override
public void attributeReplaced(ServletContextAttributeEvent event) {
    String name = event.getName();
    Object oldValue = event.getValue();  // âš ï¸ è¿™é‡Œæ˜¯æ—§å€¼ï¼Œä¸æ˜¯æ–°å€¼ï¼
    Object newValue = event.getServletContext().getAttribute(name); // æ–°å€¼éœ€è¦è¿™æ ·è·å–
    
    logger.info("å±æ€§ {} ä» {} æ›´æ”¹ä¸º {}", name, oldValue, newValue);
}
```

**ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯**
```java
@Override
public void attributeReplaced(ServletContextAttributeEvent event) {
    String name = event.getName();
    Object oldValue = event.getValue();
    Object newValue = event.getServletContext().getAttribute(name);
    
    if ("DATABASE_URL".equals(name)) {
        logger.warn("æ•°æ®åº“è¿æ¥åœ°å€å‘ç”Ÿå˜åŒ–ï¼š{} â†’ {}", oldValue, newValue);
        // å¯èƒ½éœ€è¦é‡æ–°åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
        reinitializeDataSource();
    }
    
    if (name.startsWith("CONFIG_")) {
        logger.info("é…ç½®é¡¹æ›´æ–°ï¼š{} = {}", name, newValue);
        // é€šçŸ¥ç›¸å…³æ¨¡å—é…ç½®å·²æ›´æ–°
        notifyConfigChange(name, oldValue, newValue);
    }
}
```

---

## 4. ğŸ› ï¸ å…¨å±€é…ç½®ç›‘æ§å®è·µ


### 4.1 ç³»ç»Ÿé…ç½®ç›‘æ§å™¨


**ğŸ”¸ è®¾è®¡æ€è·¯**
ç›‘æ§ç³»ç»Ÿä¸­é‡è¦é…ç½®é¡¹çš„å˜åŒ–ï¼Œç¡®ä¿é…ç½®ä¿®æ”¹èƒ½è¢«åŠæ—¶å‘ç°å’Œå¤„ç†ã€‚

```java
@WebListener
public class GlobalConfigMonitor implements ServletContextAttributeListener {
    
    private static final Set<String> CRITICAL_CONFIGS = Set.of(
        "DATABASE_URL", "REDIS_HOST", "API_KEY", "SYSTEM_MODE"
    );
    
    @Override
    public void attributeAdded(ServletContextAttributeEvent event) {
        String name = event.getName();
        if (CRITICAL_CONFIGS.contains(name)) {
            logConfigChange("ADDED", name, null, event.getValue());
            notifyAdministrators(name, "é…ç½®é¡¹å·²æ·»åŠ ");
        }
    }
    
    @Override
    public void attributeReplaced(ServletContextAttributeEvent event) {
        String name = event.getName();
        if (CRITICAL_CONFIGS.contains(name)) {
            Object oldValue = event.getValue();
            Object newValue = event.getServletContext().getAttribute(name);
            
            logConfigChange("UPDATED", name, oldValue, newValue);
            
            // æ ¹æ®é…ç½®ç±»å‹æ‰§è¡Œä¸åŒæ“ä½œ
            handleConfigUpdate(name, oldValue, newValue);
        }
    }
    
    private void handleConfigUpdate(String configName, Object oldValue, Object newValue) {
        switch (configName) {
            case "DATABASE_URL":
                // æ•°æ®åº“URLå˜åŒ–ï¼Œéœ€è¦é‡å»ºè¿æ¥æ± 
                logger.warn("æ•°æ®åº“è¿æ¥é…ç½®å‘ç”Ÿå˜åŒ–ï¼Œå»ºè®®é‡å¯åº”ç”¨");
                break;
            case "SYSTEM_MODE":
                // ç³»ç»Ÿæ¨¡å¼å˜åŒ–ï¼Œè°ƒæ•´æ—¥å¿—çº§åˆ«
                adjustLogLevel(newValue.toString());
                break;
            case "API_KEY":
                // APIå¯†é’¥å˜åŒ–ï¼Œæ¸…ç†ç›¸å…³ç¼“å­˜
                clearApiCache();
                break;
        }
    }
}
```

### 4.2 é…ç½®å˜æ›´å®¡è®¡


**ğŸ“‹ é…ç½®å˜æ›´è®°å½•è¡¨**

| æ—¶é—´æˆ³ | **é…ç½®é¡¹** | **æ“ä½œç±»å‹** | **æ—§å€¼** | **æ–°å€¼** | **æ“ä½œè€…** |
|--------|-----------|-------------|---------|---------|-----------|
| `2024-09-24 10:30:15` | `DATABASE_URL` | `UPDATED` | `jdbc:mysql://old-db` | `jdbc:mysql://new-db` | `admin` |
| `2024-09-24 10:31:22` | `REDIS_HOST` | `ADDED` | `null` | `redis.example.com` | `system` |

**ğŸ”¸ å®¡è®¡æ—¥å¿—å®ç°**
```java
private void logConfigChange(String operation, String name, Object oldValue, Object newValue) {
    Map<String, Object> auditLog = new HashMap<>();
    auditLog.put("timestamp", new Date());
    auditLog.put("operation", operation);
    auditLog.put("configName", name);
    auditLog.put("oldValue", oldValue);
    auditLog.put("newValue", newValue);
    auditLog.put("operator", getCurrentUser());
    
    // ä¿å­˜åˆ°æ•°æ®åº“æˆ–æ—¥å¿—æ–‡ä»¶
    saveAuditLog(auditLog);
}
```

---

## 5. ğŸ’¾ ç¼“å­˜æ•°æ®ç®¡ç†åº”ç”¨


### 5.1 æ™ºèƒ½ç¼“å­˜ç›‘æ§å™¨


**ğŸ”¸ è®¾è®¡ç›®æ ‡**
- ç›‘æ§ç¼“å­˜æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸ
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜
- ç»Ÿè®¡ç¼“å­˜ä½¿ç”¨æƒ…å†µ

```java
@WebListener
public class CacheDataManager implements ServletContextAttributeListener {
    
    private final Map<String, CacheInfo> cacheMetadata = new ConcurrentHashMap<>();
    
    @Override
    public void attributeAdded(ServletContextAttributeEvent event) {
        String name = event.getName();
        
        if (name.startsWith("CACHE_")) {
            // è®°å½•ç¼“å­˜åˆ›å»ºä¿¡æ¯
            CacheInfo info = new CacheInfo();
            info.setCreatedTime(System.currentTimeMillis());
            info.setAccessCount(0);
            info.setSize(calculateObjectSize(event.getValue()));
            
            cacheMetadata.put(name, info);
            
            logger.info("ğŸ“¦ ç¼“å­˜å·²åˆ›å»ºï¼š{}, å¤§å°ï¼š{} bytes", name, info.getSize());
            
            // æ£€æŸ¥ç¼“å­˜æ€»é‡æ˜¯å¦è¶…é™
            checkCacheQuota();
        }
    }
    
    @Override
    public void attributeRemoved(ServletContextAttributeEvent event) {
        String name = event.getName();
        
        if (name.startsWith("CACHE_")) {
            CacheInfo info = cacheMetadata.remove(name);
            if (info != null) {
                long lifespan = System.currentTimeMillis() - info.getCreatedTime();
                logger.info("ğŸ—‘ï¸ ç¼“å­˜å·²æ¸…ç†ï¼š{}, å­˜æ´»æ—¶é—´ï¼š{} ms, è®¿é—®æ¬¡æ•°ï¼š{}", 
                    name, lifespan, info.getAccessCount());
            }
        }
    }
    
    @Override
    public void attributeReplaced(ServletContextAttributeEvent event) {
        String name = event.getName();
        
        if (name.startsWith("CACHE_")) {
            CacheInfo info = cacheMetadata.get(name);
            if (info != null) {
                info.setAccessCount(info.getAccessCount() + 1);
                info.setLastAccessTime(System.currentTimeMillis());
                
                // æ›´æ–°ç¼“å­˜å¤§å°
                Object newValue = event.getServletContext().getAttribute(name);
                info.setSize(calculateObjectSize(newValue));
                
                logger.debug("ğŸ”„ ç¼“å­˜å·²æ›´æ–°ï¼š{}, æ–°å¤§å°ï¼š{} bytes", name, info.getSize());
            }
        }
    }
}
```

### 5.2 ç¼“å­˜æ¸…ç†ç­–ç•¥


**ğŸ”¸ è‡ªåŠ¨æ¸…ç†æœºåˆ¶**
```java
public class CacheCleanupTask {
    
    private final ServletContext context;
    private final Map<String, CacheInfo> cacheMetadata;
    
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void cleanupExpiredCache() {
        long currentTime = System.currentTimeMillis();
        
        cacheMetadata.entrySet().removeIf(entry -> {
            String cacheName = entry.getKey();
            CacheInfo info = entry.getValue();
            
            // æ¸…ç†è¶…è¿‡1å°æ—¶æœªè®¿é—®çš„ç¼“å­˜
            if (currentTime - info.getLastAccessTime() > 3600000) {
                context.removeAttribute(cacheName);
                logger.info("ğŸ§¹ è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜ï¼š{}", cacheName);
                return true;
            }
            return false;
        });
    }
}
```

**ğŸ“Š ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯**
```
=== ç¼“å­˜ä½¿ç”¨ç»Ÿè®¡ ===
æ€»ç¼“å­˜æ•°é‡ï¼š15ä¸ª
æ€»å ç”¨å†…å­˜ï¼š2.3MB
å¹³å‡è®¿é—®æ¬¡æ•°ï¼š127æ¬¡
æœ€æ´»è·ƒç¼“å­˜ï¼šCACHE_USER_PROFILES (è®¿é—®1,245æ¬¡)
æœ€å¤§ç¼“å­˜ï¼šCACHE_PRODUCT_LIST (512KB)
```

---

## 6. ğŸ“ˆ ç³»ç»ŸçŠ¶æ€è·Ÿè¸ªæœºåˆ¶


### 6.1 ç³»ç»Ÿå¥åº·çŠ¶æ€ç›‘æ§


**ğŸ”¸ ç›‘æ§æŒ‡æ ‡**
- æ´»è·ƒç”¨æˆ·æ•°é‡
- ç³»ç»Ÿè´Ÿè½½çŠ¶æ€
- å…³é”®æœåŠ¡å¯ç”¨æ€§
- é”™è¯¯ç‡ç»Ÿè®¡

```java
@WebListener
public class SystemHealthTracker implements ServletContextAttributeListener {
    
    private final SystemMetrics metrics = new SystemMetrics();
    
    @Override
    public void attributeAdded(ServletContextAttributeEvent event) {
        updateSystemMetrics(event.getName(), "ADDED", event.getValue());
    }
    
    @Override
    public void attributeRemoved(ServletContextAttributeEvent event) {
        updateSystemMetrics(event.getName(), "REMOVED", event.getValue());
    }
    
    @Override
    public void attributeReplaced(ServletContextAttributeEvent event) {
        updateSystemMetrics(event.getName(), "UPDATED", 
            event.getServletContext().getAttribute(event.getName()));
    }
    
    private void updateSystemMetrics(String attributeName, String operation, Object value) {
        switch (attributeName) {
            case "ACTIVE_USERS_COUNT":
                metrics.setActiveUsers((Integer) value);
                checkUserLoadThreshold();
                break;
                
            case "SYSTEM_LOAD":
                metrics.setSystemLoad((Double) value);
                if ((Double) value > 0.8) {
                    sendHighLoadAlert();
                }
                break;
                
            case "ERROR_COUNT":
                metrics.setErrorCount((Integer) value);
                calculateErrorRate();
                break;
        }
        
        // æ›´æ–°ç³»ç»ŸçŠ¶æ€åˆ°ç›‘æ§é¢æ¿
        publishMetricsUpdate();
    }
}
```

### 6.2 çŠ¶æ€å˜åŒ–å‘Šè­¦æœºåˆ¶


**ğŸš¨ å‘Šè­¦è§„åˆ™é…ç½®**
```java
public class AlertRuleEngine {
    
    private final List<AlertRule> rules = Arrays.asList(
        new ThresholdRule("ACTIVE_USERS_COUNT", 1000, "ç”¨æˆ·æ•°é‡è¿‡é«˜"),
        new ThresholdRule("SYSTEM_LOAD", 0.8, "ç³»ç»Ÿè´Ÿè½½è¿‡é«˜"),
        new ThresholdRule("ERROR_COUNT", 100, "é”™è¯¯æ•°é‡å¼‚å¸¸")
    );
    
    public void checkAlerts(String attributeName, Object value) {
        rules.stream()
            .filter(rule -> rule.matches(attributeName, value))
            .forEach(rule -> {
                sendAlert(rule.getMessage(), attributeName, value);
                logger.warn("ğŸš¨ ç³»ç»Ÿå‘Šè­¦ï¼š{} - {} = {}", 
                    rule.getMessage(), attributeName, value);
            });
    }
}
```

**ğŸ“± å¤šæ¸ é“å‘Šè­¦é€šçŸ¥**
```
å‘Šè­¦æ¸ é“ä¼˜å…ˆçº§ï¼š
1. ğŸ”´ ä¸¥é‡å‘Šè­¦ â†’ çŸ­ä¿¡ + é‚®ä»¶ + é’‰é’‰
2. ğŸŸ¡ è­¦å‘Šä¿¡æ¯ â†’ é‚®ä»¶ + é’‰é’‰  
3. ğŸŸ¢ ä¸€èˆ¬ä¿¡æ¯ â†’ ç³»ç»Ÿæ—¥å¿—
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ServletContextAttributeListenerï¼šç›‘å¬ServletContextå±æ€§å˜åŒ–çš„æ¥å£
ğŸ”¸ ä¸‰å¤§ç›‘å¬æ–¹æ³•ï¼šattributeAddedã€attributeRemovedã€attributeReplaced
ğŸ”¸ äº‹ä»¶å¯¹è±¡ï¼šServletContextAttributeEventæä¾›å±æ€§å˜åŒ–çš„è¯¦ç»†ä¿¡æ¯
ğŸ”¸ è‡ªåŠ¨è§¦å‘ï¼šå®¹å™¨è‡ªåŠ¨è°ƒç”¨ï¼Œæ— éœ€æ‰‹åŠ¨æ‰§è¡Œ
ğŸ”¸ å…¨å±€èŒƒå›´ï¼šç›‘æ§æ•´ä¸ªWebåº”ç”¨çš„å…±äº«æ•°æ®å˜åŒ–
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘å¬å™¨çš„è§¦å‘æ—¶æœº**
```
å±æ€§æ·»åŠ ï¼šsetAttribute()æ—¶å±æ€§ä¸å­˜åœ¨ â†’ attributeAdded()
å±æ€§ç§»é™¤ï¼šremoveAttribute()æ—¶å±æ€§å­˜åœ¨ â†’ attributeRemoved()  
å±æ€§æ›¿æ¢ï¼šsetAttribute()æ—¶å±æ€§å·²å­˜åœ¨ â†’ attributeReplaced()

é‡è¦æé†’ï¼šattributeReplaced()ä¸­event.getValue()è¿”å›çš„æ˜¯æ—§å€¼ï¼
```

**ğŸ”¹ å®é™…åº”ç”¨åœºæ™¯é€‰æ‹©**
```
é…ç½®ç›‘æ§ï¼šç›‘æ§ç³»ç»Ÿé…ç½®çš„å˜åŒ–ï¼Œç¡®ä¿å…³é”®é…ç½®ä¿®æ”¹è¢«è®°å½•
ç¼“å­˜ç®¡ç†ï¼šè·Ÿè¸ªç¼“å­˜æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ç°æ™ºèƒ½æ¸…ç†
çŠ¶æ€è·Ÿè¸ªï¼šç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ï¼Œå®ç°å®æ—¶å‘Šè­¦
èµ„æºç®¡ç†ï¼šç›‘æ§å…±äº«èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œé˜²æ­¢èµ„æºæ³„éœ²
```

**ğŸ”¹ æ€§èƒ½å’Œå®‰å…¨è€ƒè™‘**
```
æ€§èƒ½å½±å“ï¼šç›‘å¬å™¨ä¼šåœ¨æ¯æ¬¡å±æ€§å˜åŒ–æ—¶æ‰§è¡Œï¼Œé¿å…è€—æ—¶æ“ä½œ
çº¿ç¨‹å®‰å…¨ï¼šå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶ä¿®æ”¹å±æ€§ï¼Œæ³¨æ„å¹¶å‘è®¿é—®
å¼‚å¸¸å¤„ç†ï¼šç›‘å¬å™¨å¼‚å¸¸ä¸åº”å½±å“æ­£å¸¸ä¸šåŠ¡æµç¨‹
æ—¥å¿—ç®¡ç†ï¼šåˆç†æ§åˆ¶æ—¥å¿—è¾“å‡ºï¼Œé¿å…æ—¥å¿—çˆ†ç‚¸
```

### 7.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ ç›‘å¬å™¨è®¾è®¡åŸåˆ™**
- **è½»é‡åŒ–æ“ä½œ**ï¼šç›‘å¬å™¨ä¸­åªåšå¿…è¦çš„è½»é‡çº§æ“ä½œ
- **å¼‚æ­¥å¤„ç†**ï¼šå¤æ‚ä¸šåŠ¡é€»è¾‘æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹å¤„ç†
- **å¼‚å¸¸éš”ç¦»**ï¼šç›‘å¬å™¨å¼‚å¸¸ä¸èƒ½å½±å“ä¸»ä¸šåŠ¡æµç¨‹
- **æœ‰é€‰æ‹©æ€§**ï¼šåªç›‘å¬å…³å¿ƒçš„å±æ€§ï¼Œé¿å…æ— æ•ˆå¤„ç†

**ğŸ”§ ä»£ç å®ç°æŠ€å·§**
- ä½¿ç”¨å±æ€§åå‰ç¼€è¿›è¡Œåˆ†ç±»ç®¡ç†
- åˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
- å®ç°ä¼˜é›…çš„é™çº§æœºåˆ¶
- æ·»åŠ å®Œæ•´çš„æ—¥å¿—å’Œç›‘æ§

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å±æ€§ç›‘å¬ä¸‰å…„å¼Ÿï¼šå¢åˆ æ”¹æ ·æ ·é½
- å…¨å±€å…±äº«çœ‹é—¨äººï¼šå˜åŒ–å¿…çŸ¥æˆ‘å…ˆçŸ¥  
- é…ç½®ç¼“å­˜çŠ¶æ€ç®¡ï¼šç³»ç»Ÿå¥åº·æˆ‘æ¥çœ‹
- è½»é‡å¼‚æ­¥è¦è®°ä½ï¼šæ€§èƒ½å®‰å…¨ä¸èƒ½è¾“