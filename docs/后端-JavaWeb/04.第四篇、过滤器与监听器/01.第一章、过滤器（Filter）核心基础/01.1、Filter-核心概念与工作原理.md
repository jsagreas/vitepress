---
title: 1ã€Filter-æ ¸å¿ƒæ¦‚å¿µä¸å·¥ä½œåŸç†
---
## ğŸ“š ç›®å½•

1. [è¿‡æ»¤å™¨(Filter)æ ¸å¿ƒåŸºç¡€](#1-è¿‡æ»¤å™¨Filteræ ¸å¿ƒåŸºç¡€)
2. [è¿‡æ»¤å™¨å®ç°ä¸é…ç½®](#2-è¿‡æ»¤å™¨å®ç°ä¸é…ç½®)
3. [è¿‡æ»¤å™¨é“¾æœºåˆ¶è¯¦è§£](#3-è¿‡æ»¤å™¨é“¾æœºåˆ¶è¯¦è§£)
4. [ç›‘å¬å™¨(Listener)åŸºç¡€æ¦‚å¿µ](#4-ç›‘å¬å™¨ListeneråŸºç¡€æ¦‚å¿µ)
5. [ç›‘å¬å™¨ç±»å‹ä¸åº”ç”¨](#5-ç›‘å¬å™¨ç±»å‹ä¸åº”ç”¨)
6. [å®é™…é¡¹ç›®åº”ç”¨åœºæ™¯](#6-å®é™…é¡¹ç›®åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” è¿‡æ»¤å™¨(Filter)æ ¸å¿ƒåŸºç¡€


### 1.1 Filteræ¦‚å¿µç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨ï¼Ÿ**

> è¿‡æ»¤å™¨å°±åƒæ˜¯**é—¨å«**ä¸€æ ·ï¼Œç«™åœ¨Webåº”ç”¨çš„å…¥å£å¤„ï¼Œå¯¹è¿›å‡ºçš„è¯·æ±‚å’Œå“åº”è¿›è¡Œæ£€æŸ¥å’Œå¤„ç†ã€‚

æƒ³è±¡ä¸€ä¸‹ç°å®ç”Ÿæ´»ä¸­çš„åœºæ™¯ï¼š
- **å°åŒºé—¨å«**ï¼šæ£€æŸ¥æ¥è®¿äººå‘˜èº«ä»½ï¼Œå†³å®šæ˜¯å¦æ”¾è¡Œ
- **å®‰æ£€æœºå™¨**ï¼šè¿‡æ»¤å±é™©ç‰©å“ï¼Œç¡®ä¿å®‰å…¨
- **æ°´è¿‡æ»¤å™¨**ï¼šå‡€åŒ–æ°´è´¨ï¼Œå»é™¤æ‚è´¨

JavaWebä¸­çš„è¿‡æ»¤å™¨ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼š

```
å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†æµç¨‹ï¼š

æµè§ˆå™¨ â”€â”€è¯·æ±‚â”€â”€> Filter1 â”€â”€> Filter2 â”€â”€> Servlet â”€â”€> JSP
   â†‘                â†“        â†“        â†“       â†“
   â””â”€â”€â”€â”€â”€å“åº”â”€â”€â”€ Filter1 â†â”€â”€ Filter2 â†â”€â”€ Servlet â†â”€â”€ JSP
```

**ğŸ”¸ è¿‡æ»¤å™¨çš„æœ¬è´¨**
- **æ‹¦æˆªå™¨è§’è‰²**ï¼šåœ¨è¯·æ±‚åˆ°è¾¾ç›®æ ‡èµ„æºå‰è¿›è¡Œæ‹¦æˆª
- **åŒå‘å¤„ç†**ï¼šæ—¢å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥å¤„ç†å“åº”
- **é€æ˜æ€§**ï¼šå¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯é€æ˜çš„
- **å¯é“¾å¼è°ƒç”¨**ï¼šå¤šä¸ªè¿‡æ»¤å™¨å¯ä»¥ä¸²è”ä½¿ç”¨

### 1.2 Filteræ¥å£å®šä¹‰


**ğŸ“‹ Filteræ¥å£æ ¸å¿ƒæ–¹æ³•**

Filteræ¥å£å®šä¹‰äº†ä¸‰ä¸ªå…³é”®æ–¹æ³•ï¼Œå°±åƒä¸€ä¸ªæ ‡å‡†åŒ–çš„"é—¨å«å·¥ä½œæµç¨‹"ï¼š

```java
public interface Filter {
    // 1. åˆå§‹åŒ–æ–¹æ³• - è¿‡æ»¤å™¨å¯åŠ¨æ—¶è°ƒç”¨
    void init(FilterConfig filterConfig) throws ServletException;
    
    // 2. è¿‡æ»¤æ–¹æ³• - æ¯æ¬¡è¯·æ±‚æ—¶è°ƒç”¨ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
    void doFilter(ServletRequest request, ServletResponse response, 
                  FilterChain chain) throws IOException, ServletException;
    
    // 3. é”€æ¯æ–¹æ³• - è¿‡æ»¤å™¨å…³é—­æ—¶è°ƒç”¨
    void destroy();
}
```

**ğŸ”§ æ–¹æ³•è¯¦è§£**

| **æ–¹æ³•** | **è°ƒç”¨æ—¶æœº** | **ä½œç”¨** | **ç”Ÿæ´»æ¯”å–»** |
|---------|-------------|---------|-------------|
| `init()` | æœåŠ¡å™¨å¯åŠ¨æ—¶ | è¿‡æ»¤å™¨åˆå§‹åŒ–é…ç½® | é—¨å«ä¸Šç­å‰çš„å‡†å¤‡å·¥ä½œ |
| `doFilter()` | æ¯æ¬¡è¯·æ±‚æ—¶ | æ‰§è¡Œè¿‡æ»¤é€»è¾‘ | é—¨å«æ£€æŸ¥æ¯ä¸ªæ¥è®¿è€… |
| `destroy()` | æœåŠ¡å™¨å…³é—­æ—¶ | æ¸…ç†èµ„æº | é—¨å«ä¸‹ç­åçš„æ”¶å°¾å·¥ä½œ |

### 1.3 è¿‡æ»¤å™¨å·¥ä½œæœºåˆ¶æ·±åº¦ç†è§£


**âš¡ è¯·æ±‚æ‹¦æˆªæœºåˆ¶**

è¿‡æ»¤å™¨çš„å·¥ä½œåŸç†å¯ä»¥ç”¨"å±‚å±‚æŠŠå…³"æ¥ç†è§£ï¼š

```
è¯·æ±‚å¤„ç†çš„"æ´‹è‘±æ¨¡å‹"ï¼š

        å¤–å±‚è¿‡æ»¤å™¨A
       /              \
    è¯·æ±‚è¿›å…¥          å“åº”è¿”å›
     /                  \
  å†…å±‚è¿‡æ»¤å™¨B          å†…å±‚è¿‡æ»¤å™¨B
   /                      \
ç›®æ ‡Servlet              ç›®æ ‡Servlet
```

**ğŸ¯ æ ¸å¿ƒå·¥ä½œæµç¨‹**

1. **è¯·æ±‚åˆ°è¾¾**ï¼šå®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚
2. **è¿‡æ»¤å™¨æ‹¦æˆª**ï¼šæŒ‰é…ç½®é¡ºåºä¾æ¬¡ç»è¿‡è¿‡æ»¤å™¨
3. **å†³ç­–å¤„ç†**ï¼šæ¯ä¸ªè¿‡æ»¤å™¨å†³å®šæ˜¯å¦ç»§ç»­ä¼ é€’è¯·æ±‚
4. **åˆ°è¾¾ç›®æ ‡**ï¼šè¯·æ±‚æœ€ç»ˆåˆ°è¾¾Servletæˆ–JSP
5. **å“åº”è¿”å›**ï¼šå“åº”æŒ‰ç›¸åé¡ºåºç»è¿‡è¿‡æ»¤å™¨
6. **æœ€ç»ˆè¾“å‡º**ï¼šå¤„ç†åçš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯

### 1.4 FilterChainè¿‡æ»¤å™¨é“¾


**ğŸ”— è¿‡æ»¤å™¨é“¾çš„ä½œç”¨**

FilterChainå°±åƒä¸€ä¸ª"ä¼ é€å¸¦"ï¼Œè´Ÿè´£å°†è¯·æ±‚åœ¨è¿‡æ»¤å™¨ä¹‹é—´ä¼ é€’ï¼š

```java
// è¿‡æ»¤å™¨é“¾çš„æ ¸å¿ƒæ–¹æ³•
public interface FilterChain {
    void doFilter(ServletRequest request, ServletResponse response) 
        throws IOException, ServletException;
}
```

**ğŸ’¡ é“¾å¼è°ƒç”¨åŸç†**

```java
public class MyFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // è¯·æ±‚å¤„ç† - åœ¨ç›®æ ‡èµ„æºæ‰§è¡Œå‰
        System.out.println("è¯·æ±‚è¿›å…¥è¿‡æ»¤å™¨");
        
        // æ ¸å¿ƒï¼šè°ƒç”¨é“¾çš„ä¸‹ä¸€ä¸ªç¯èŠ‚
        chain.doFilter(request, response);
        
        // å“åº”å¤„ç† - åœ¨ç›®æ ‡èµ„æºæ‰§è¡Œå
        System.out.println("å“åº”ç¦»å¼€è¿‡æ»¤å™¨");
    }
}
```

**ğŸ”„ é“¾å¼è°ƒç”¨æµç¨‹å›¾**

```
è¿‡æ»¤å™¨é“¾æ‰§è¡Œé¡ºåºï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Filter A   â”‚â”€â”€â”€â–¶â”‚  Filter B   â”‚â”€â”€â”€â–¶â”‚   Servlet   â”‚
â”‚ (æƒé™æ£€æŸ¥)  â”‚    â”‚ (ç¼–ç è®¾ç½®)  â”‚    â”‚ (ä¸šåŠ¡å¤„ç†)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                   â–²                   â”‚
       â”‚                   â”‚                   â–¼
    å“åº”å¤„ç†            å“åº”å¤„ç†            ç”Ÿæˆå“åº”
```

**âš ï¸ é‡è¦ç†è§£è¦ç‚¹**

- å¦‚æœä¸è°ƒç”¨`chain.doFilter()`ï¼Œè¯·æ±‚å°±**åœåœ¨å½“å‰è¿‡æ»¤å™¨**ï¼Œä¸ä¼šç»§ç»­å‘ä¸‹ä¼ é€’
- `chain.doFilter()`ä¹‹å‰çš„ä»£ç å¤„ç†**è¯·æ±‚**
- `chain.doFilter()`ä¹‹åçš„ä»£ç å¤„ç†**å“åº”**
- è¿‡æ»¤å™¨çš„å“åº”å¤„ç†é¡ºåºä¸è¯·æ±‚å¤„ç†é¡ºåº**ç›¸å**

---

## 2. âš™ï¸ è¿‡æ»¤å™¨å®ç°ä¸é…ç½®


### 2.1 åˆ›å»ºè‡ªå®šä¹‰è¿‡æ»¤å™¨


**ğŸ› ï¸ åŸºç¡€è¿‡æ»¤å™¨å®ç°**

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨ï¼š

```java
// ç™»å½•éªŒè¯è¿‡æ»¤å™¨
public class LoginFilter implements Filter {
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        System.out.println("ç™»å½•è¿‡æ»¤å™¨åˆå§‹åŒ–å®Œæˆ");
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // è·å–å½“å‰è®¿é—®è·¯å¾„
        String uri = req.getRequestURI();
        
        // æ’é™¤ç™»å½•é¡µé¢å’Œå…¬å…±èµ„æº
        if (uri.endsWith("login.jsp") || uri.endsWith("login") || 
            uri.contains("css") || uri.contains("js")) {
            chain.doFilter(request, response);
            return;
        }
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
        Object user = req.getSession().getAttribute("user");
        if (user == null) {
            // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
            resp.sendRedirect("login.jsp");
        } else {
            // å·²ç™»å½•ï¼Œç»§ç»­å¤„ç†
            chain.doFilter(request, response);
        }
    }
    
    @Override
    public void destroy() {
        System.out.println("ç™»å½•è¿‡æ»¤å™¨é”€æ¯");
    }
}
```

### 2.2 è¿‡æ»¤å™¨é…ç½®æ–¹å¼


**ğŸ“ æ³¨è§£é…ç½®ï¼ˆæ¨èæ–¹å¼ï¼‰**

ä½¿ç”¨`@WebFilter`æ³¨è§£æ˜¯æœ€ç®€å•ç›´æ¥çš„é…ç½®æ–¹å¼ï¼š

```java
@WebFilter(
    filterName = "encodingFilter",           // è¿‡æ»¤å™¨åç§°
    urlPatterns = {"/*"},                    // æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
    initParams = {                           // åˆå§‹åŒ–å‚æ•°
        @WebInitParam(name = "encoding", value = "UTF-8")
    }
)
public class EncodingFilter implements Filter {
    private String encoding;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // è·å–åˆå§‹åŒ–å‚æ•°
        encoding = filterConfig.getInitParameter("encoding");
        if (encoding == null) {
            encoding = "UTF-8"; // é»˜è®¤ç¼–ç 
        }
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        // è®¾ç½®è¯·æ±‚å’Œå“åº”ç¼–ç 
        request.setCharacterEncoding(encoding);
        response.setCharacterEncoding(encoding);
        
        chain.doFilter(request, response);
    }
}
```

**ğŸ“„ web.xmlé…ç½®æ–¹å¼**

å¯¹äºä¸æ”¯æŒæ³¨è§£çš„ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„XMLé…ç½®ï¼š

```xml
<web-app>
    <!-- å®šä¹‰è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>loginFilter</filter-name>
        <filter-class>com.example.filter.LoginFilter</filter-class>
        <init-param>
            <param-name>excludePaths</param-name>
            <param-value>/login.jsp,/register.jsp</param-value>
        </init-param>
    </filter>
    
    <!-- é…ç½®è¿‡æ»¤å™¨æ˜ å°„ -->
    <filter-mapping>
        <filter-name>loginFilter</filter-name>
        <url-pattern>/admin/*</url-pattern>  <!-- åªæ‹¦æˆªadminç›®å½• -->
    </filter-mapping>
</web-app>
```

### 2.3 URLæ¨¡å¼é…ç½®è¯¦è§£


**ğŸ¯ URLåŒ¹é…æ¨¡å¼**

| **æ¨¡å¼** | **è¯´æ˜** | **ç¤ºä¾‹** | **åŒ¹é…èŒƒå›´** |
|---------|---------|---------|-------------|
| `/*` | åŒ¹é…æ‰€æœ‰è¯·æ±‚ | `/*` | æ‰€æœ‰è·¯å¾„ |
| `/admin/*` | è·¯å¾„åŒ¹é… | `/admin/*` | /admin/ä¸‹æ‰€æœ‰èµ„æº |
| `*.jsp` | æ‰©å±•ååŒ¹é… | `*.jsp` | æ‰€æœ‰JSPé¡µé¢ |
| `/login` | ç²¾ç¡®åŒ¹é… | `/login` | ä»…åŒ¹é…/login |

**ğŸ’¡ é…ç½®å»ºè®®**

```java
// ç¤ºä¾‹ï¼šä¸åŒåœºæ™¯çš„è¿‡æ»¤å™¨é…ç½®
@WebFilter("/*")                    // ç¼–ç è¿‡æ»¤å™¨ï¼šæ‰€æœ‰è¯·æ±‚
@WebFilter("/admin/*")              // æƒé™è¿‡æ»¤å™¨ï¼šç®¡ç†å‘˜é¡µé¢
@WebFilter("*.jsp")                 // é¡µé¢è¿‡æ»¤å™¨ï¼šJSPé¡µé¢
@WebFilter(urlPatterns = {"/api/*", "*.json"}) // APIè¿‡æ»¤å™¨ï¼šå¤šç§æ¨¡å¼
```

---

## 3. ğŸ”„ è¿‡æ»¤å™¨é“¾æœºåˆ¶è¯¦è§£


### 3.1 è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº


**ğŸ“Š æ‰§è¡Œé¡ºåºè§„åˆ™**

è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºå°±åƒæ’é˜Ÿä¸€æ ·ï¼Œéµå¾ªä¸€å®šçš„è§„åˆ™ï¼š

1. **æ³¨è§£é…ç½®**ï¼šæŒ‰ç…§ç±»åçš„**å­—æ¯é¡ºåº**æ‰§è¡Œ
2. **XMLé…ç½®**ï¼šæŒ‰ç…§åœ¨`web.xml`ä¸­çš„**å£°æ˜é¡ºåº**æ‰§è¡Œ
3. **æ··åˆé…ç½®**ï¼šXMLé…ç½®çš„è¿‡æ»¤å™¨ä¼˜å…ˆäºæ³¨è§£é…ç½®

**ğŸ”¢ æ‰§è¡Œé¡ºåºç¤ºä¾‹**

```java
// æŒ‰å­—æ¯é¡ºåºæ‰§è¡Œï¼šA â†’ B â†’ C
@WebFilter("/*")
public class ALogFilter implements Filter { ... }

@WebFilter("/*") 
public class BSecurityFilter implements Filter { ... }

@WebFilter("/*")
public class CEncodingFilter implements Filter { ... }
```

**ğŸ­ å®é™…æ‰§è¡Œæµç¨‹**

```
è¯·æ±‚å¤„ç†ï¼šALogFilter â†’ BSecurityFilter â†’ CEncodingFilter â†’ Servlet
å“åº”å¤„ç†ï¼šServlet â†’ CEncodingFilter â†’ BSecurityFilter â†’ ALogFilter
```

### 3.2 è¿‡æ»¤å™¨é“¾å®æˆ˜æ¡ˆä¾‹


**ğŸ›¡ï¸ å®Œæ•´çš„Webåº”ç”¨è¿‡æ»¤å™¨é“¾**

è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨è¿‡æ»¤å™¨é“¾ï¼š

```java
// 1. ç¼–ç è¿‡æ»¤å™¨ï¼ˆæœ€å…ˆæ‰§è¡Œï¼‰
@WebFilter(value = "/*", filterName = "AEncodingFilter")
public class AEncodingFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        System.out.println("1. è®¾ç½®è¯·æ±‚å“åº”ç¼–ç ");
        request.setCharacterEncoding("UTF-8");
        response.setCharacterEncoding("UTF-8");
        
        chain.doFilter(request, response);
        
        System.out.println("6. ç¼–ç è¿‡æ»¤å™¨å“åº”å¤„ç†å®Œæˆ");
    }
}

// 2. ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨
@WebFilter(value = "/*", filterName = "BLoginFilter")
public class BLoginFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        System.out.println("2. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€");
        
        // ç™»å½•æ£€æŸ¥é€»è¾‘
        chain.doFilter(request, response);
        
        System.out.println("5. ç™»å½•è¿‡æ»¤å™¨å“åº”å¤„ç†å®Œæˆ");
    }
}

// 3. æƒé™éªŒè¯è¿‡æ»¤å™¨ï¼ˆæœ€åæ‰§è¡Œï¼‰
@WebFilter(value = "/*", filterName = "CAuthFilter")
public class CAuthFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        System.out.println("3. éªŒè¯ç”¨æˆ·æƒé™");
        
        // æƒé™æ£€æŸ¥é€»è¾‘
        chain.doFilter(request, response);
        
        System.out.println("4. æƒé™è¿‡æ»¤å™¨å“åº”å¤„ç†å®Œæˆ");
    }
}
```

### 3.3 æ¨ªåˆ‡å…³æ³¨ç‚¹ç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Ÿ**

æ¨ªåˆ‡å…³æ³¨ç‚¹æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¦‚å¿µï¼Œç”¨æ—¥å¸¸è¯è¯´å°±æ˜¯ï¼š"**è·¨è¶Šå¤šä¸ªåŠŸèƒ½æ¨¡å—çš„é€šç”¨éœ€æ±‚**"ã€‚

```
Webåº”ç”¨çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç®¡ç†   â”‚  â”‚   å•†å“ç®¡ç†   â”‚  â”‚   è®¢å•ç®¡ç†   â”‚
â”‚             â”‚  â”‚             â”‚  â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç™»å½•æ£€æŸ¥   â”‚  â”‚  ç™»å½•æ£€æŸ¥   â”‚  â”‚  ç™»å½•æ£€æŸ¥   â”‚  â† æ¨ªåˆ‡å…³æ³¨ç‚¹
â”‚  æƒé™éªŒè¯   â”‚  â”‚  æƒé™éªŒè¯   â”‚  â”‚  æƒé™éªŒè¯   â”‚  â† æ¨ªåˆ‡å…³æ³¨ç‚¹
â”‚  æ—¥å¿—è®°å½•   â”‚  â”‚  æ—¥å¿—è®°å½•   â”‚  â”‚  æ—¥å¿—è®°å½•   â”‚  â† æ¨ªåˆ‡å…³æ³¨ç‚¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ è¿‡æ»¤å™¨è§£å†³çš„æ¨ªåˆ‡å…³æ³¨ç‚¹**

- **å®‰å…¨æ€§**ï¼šç™»å½•éªŒè¯ã€æƒé™æ£€æŸ¥ã€é˜²SQLæ³¨å…¥
- **æ€§èƒ½**ï¼šç¼“å­˜æ§åˆ¶ã€å‹ç¼©å¤„ç†
- **ç»´æŠ¤æ€§**ï¼šæ—¥å¿—è®°å½•ã€é”™è¯¯å¤„ç†
- **å›½é™…åŒ–**ï¼šå­—ç¬¦ç¼–ç ã€è¯­è¨€è®¾ç½®

---

## 4. ğŸ‘‚ ç›‘å¬å™¨(Listener)åŸºç¡€æ¦‚å¿µ


### 4.1 ç›‘å¬å™¨æ¦‚å¿µç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯ç›‘å¬å™¨ï¼Ÿ**

> ç›‘å¬å™¨å°±åƒæ˜¯**è§‚å¯Ÿå‘˜**ï¼Œä¸“é—¨ç›‘è§†ç‰¹å®šäº‹ä»¶çš„å‘ç”Ÿï¼Œä¸€æ—¦äº‹ä»¶å‘ç”Ÿå°±ç«‹å³æ‰§è¡Œç›¸åº”çš„å¤„ç†ã€‚

ç”Ÿæ´»ä¸­çš„ç›‘å¬å™¨ä¾‹å­ï¼š
- **çƒŸé›¾æŠ¥è­¦å™¨**ï¼šç›‘å¬çƒŸé›¾æµ“åº¦ï¼Œè¶…æ ‡å°±æŠ¥è­¦
- **é—¨é“ƒ**ï¼šç›‘å¬æŒ‰é“ƒåŠ¨ä½œï¼Œæœ‰äººæŒ‰å°±å“é“ƒ
- **ä½“é‡ç§¤**ï¼šç›‘å¬é‡é‡å˜åŒ–ï¼Œæ˜¾ç¤ºå½“å‰æ•°å€¼

**ğŸ”¸ ç›‘å¬å™¨çš„æœ¬è´¨**
- **äº‹ä»¶é©±åŠ¨**ï¼šåŸºäºäº‹ä»¶å‘ç”Ÿè§¦å‘æ‰§è¡Œ
- **è¢«åŠ¨å“åº”**ï¼šä¸ä¸»åŠ¨æ‰§è¡Œï¼Œç­‰å¾…äº‹ä»¶å‘ç”Ÿ
- **è§£è€¦è®¾è®¡**ï¼šäº‹ä»¶æºå’Œå¤„ç†é€»è¾‘åˆ†ç¦»
- **è‡ªåŠ¨æ‰§è¡Œ**ï¼šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨è°ƒç”¨

### 4.2 Webç›‘å¬å™¨åˆ†ç±»ä½“ç³»


**ğŸ“Š ç›‘å¬å™¨åˆ†ç±»ç»“æ„**

```
JavaWebç›‘å¬å™¨ä½“ç³»ï¼š

                    ç›‘å¬å™¨(Listener)
                   /        |        \
              åŸŸå¯¹è±¡ç›‘å¬    åŸŸå¯¹è±¡å±æ€§ç›‘å¬   Sessionç›‘å¬
               /    \        /    \         /       \
        ServletContext  HttpSession  å±æ€§æ·»åŠ   å±æ€§ç§»é™¤  å¯¹è±¡ç»‘å®š  å¯¹è±¡è§£ç»‘
```

**ğŸ­ ä¸‰å¤§ç±»ç›‘å¬å™¨**

| **ç±»åˆ«** | **ç›‘å¬å†…å®¹** | **åº”ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| **åŸŸå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç›‘å¬** | å¯¹è±¡åˆ›å»ºã€é”€æ¯ | èµ„æºåˆå§‹åŒ–ã€æ¸…ç†å·¥ä½œ |
| **åŸŸå¯¹è±¡å±æ€§ç›‘å¬** | å±æ€§å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ | æ•°æ®å˜åŒ–è·Ÿè¸ª |
| **Sessionç›¸å…³ç›‘å¬** | ä¼šè¯ç»‘å®šã€è§£ç»‘ | ç”¨æˆ·è¡Œä¸ºåˆ†æ |

### 4.3 ç›‘å¬å™¨å·¥ä½œæœºåˆ¶


**âš¡ äº‹ä»¶é©±åŠ¨æ¨¡å‹**

```
ç›‘å¬å™¨å·¥ä½œæµç¨‹ï¼š

äº‹ä»¶æºå¯¹è±¡ â”€â”€å‘ç”Ÿäº‹ä»¶â”€â”€> ç›‘å¬å™¨æ¥å£ â”€â”€è§¦å‘æ–¹æ³•â”€â”€> å…·ä½“ç›‘å¬å™¨å®ç°
    â†“                      â†“                    â†“
ServletContext          ç”Ÿå‘½å‘¨æœŸäº‹ä»¶         contextInitialized()
HttpSession            å±æ€§å˜åŒ–äº‹ä»¶         attributeAdded()
HttpServletRequest     å¯¹è±¡ç»‘å®šäº‹ä»¶         valueBound()
```

**ğŸ”„ ç›‘å¬å™¨ä¸å®¹å™¨äº¤äº’**

ç›‘å¬å™¨æ˜¯ç”±Servletå®¹å™¨è‡ªåŠ¨ç®¡ç†çš„ï¼š

1. **è‡ªåŠ¨æ³¨å†Œ**ï¼šå®¹å™¨å¯åŠ¨æ—¶æ‰«æå¹¶æ³¨å†Œç›‘å¬å™¨
2. **äº‹ä»¶åˆ†å‘**ï¼šå®¹å™¨è´Ÿè´£å°†äº‹ä»¶åˆ†å‘ç»™ç›¸åº”ç›‘å¬å™¨
3. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šå®¹å™¨ç®¡ç†ç›‘å¬å™¨çš„åˆ›å»ºå’Œé”€æ¯

---

## 5. ğŸ¯ ç›‘å¬å™¨ç±»å‹ä¸åº”ç”¨


### 5.1 ServletContextç›‘å¬å™¨


**ğŸ—ï¸ åº”ç”¨ç”Ÿå‘½å‘¨æœŸç›‘å¬**

ServletContextListeneræ˜¯æœ€é‡è¦çš„ç›‘å¬å™¨ï¼Œç›‘å¬æ•´ä¸ªWebåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼š

```java
@WebListener
public class AppInitListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("Webåº”ç”¨å¯åŠ¨äº†ï¼");
        
        ServletContext context = sce.getServletContext();
        
        // åˆå§‹åŒ–å…¨å±€é…ç½®
        Properties config = loadConfiguration();
        context.setAttribute("appConfig", config);
        
        // åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
        DataSource dataSource = initDataSource();
        context.setAttribute("dataSource", dataSource);
        
        System.out.println("åº”ç”¨åˆå§‹åŒ–å®Œæˆ");
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("Webåº”ç”¨å…³é—­äº†ï¼");
        
        // æ¸…ç†èµ„æº
        DataSource ds = (DataSource) sce.getServletContext()
                                        .getAttribute("dataSource");
        if (ds != null) {
            // å…³é—­æ•°æ®åº“è¿æ¥æ± 
            closeDataSource(ds);
        }
        
        System.out.println("åº”ç”¨æ¸…ç†å®Œæˆ");
    }
    
    private Properties loadConfiguration() {
        // åŠ è½½é…ç½®æ–‡ä»¶é€»è¾‘
        return new Properties();
    }
}
```

**ğŸ¯ å®é™…åº”ç”¨åœºæ™¯**

- **ç³»ç»Ÿåˆå§‹åŒ–**ï¼šåŠ è½½é…ç½®æ–‡ä»¶ã€åˆå§‹åŒ–è¿æ¥æ± 
- **èµ„æºæ¸…ç†**ï¼šå…³é—­è¿æ¥ã€æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- **å…¨å±€å¯¹è±¡åˆ›å»º**ï¼šåˆ›å»ºå…±äº«çš„å·¥å…·ç±»å®ä¾‹

### 5.2 HttpSessionç›‘å¬å™¨


**ğŸ‘¥ ä¼šè¯ç®¡ç†ç›‘å¬**

```java
@WebListener
public class SessionListener implements HttpSessionListener, HttpSessionAttributeListener {
    
    // ä¼šè¯åˆ›å»ºæ—¶è°ƒç”¨
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        System.out.println("æ–°ç”¨æˆ·è®¿é—®ï¼ŒSessionåˆ›å»ºï¼š" + se.getSession().getId());
        
        // ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°
        ServletContext context = se.getSession().getServletContext();
        Integer onlineUsers = (Integer) context.getAttribute("onlineUsers");
        if (onlineUsers == null) {
            onlineUsers = 0;
        }
        context.setAttribute("onlineUsers", onlineUsers + 1);
    }
    
    // ä¼šè¯é”€æ¯æ—¶è°ƒç”¨
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        System.out.println("ç”¨æˆ·ç¦»å¼€ï¼ŒSessioné”€æ¯ï¼š" + se.getSession().getId());
        
        // å‡å°‘åœ¨çº¿ç”¨æˆ·æ•°
        ServletContext context = se.getSession().getServletContext();
        Integer onlineUsers = (Integer) context.getAttribute("onlineUsers");
        if (onlineUsers != null && onlineUsers > 0) {
            context.setAttribute("onlineUsers", onlineUsers - 1);
        }
    }
    
    // Sessionå±æ€§æ·»åŠ æ—¶è°ƒç”¨
    @Override
    public void attributeAdded(HttpSessionBindingEvent event) {
        String name = event.getName();
        Object value = event.getValue();
        System.out.println("Sessionå±æ€§æ·»åŠ ï¼š" + name + " = " + value);
        
        // ç”¨æˆ·ç™»å½•æ—¶è®°å½•
        if ("user".equals(name)) {
            System.out.println("ç”¨æˆ·ç™»å½•ï¼š" + value);
        }
    }
}
```

### 5.3 HttpServletRequestç›‘å¬å™¨


**ğŸ“ è¯·æ±‚å¤„ç†ç›‘å¬**

```java
@WebListener
public class RequestListener implements ServletRequestListener, ServletRequestAttributeListener {
    
    @Override
    public void requestInitialized(ServletRequestEvent sre) {
        HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();
        
        // è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
        request.setAttribute("startTime", System.currentTimeMillis());
        
        System.out.println("è¯·æ±‚å¼€å§‹ï¼š" + request.getRequestURI());
    }
    
    @Override
    public void requestDestroyed(ServletRequestEvent sre) {
        HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();
        
        // è®¡ç®—è¯·æ±‚å¤„ç†æ—¶é—´
        Long startTime = (Long) request.getAttribute("startTime");
        if (startTime != null) {
            long duration = System.currentTimeMillis() - startTime;
            System.out.println("è¯·æ±‚ç»“æŸï¼š" + request.getRequestURI() + 
                             "ï¼Œè€—æ—¶ï¼š" + duration + "ms");
        }
    }
}
```

### 5.4 ç‰¹æ®Šç›‘å¬å™¨ï¼šHttpSessionBindingListener


**ğŸ”— å¯¹è±¡ç»‘å®šç›‘å¬**

è¿™ä¸ªç›‘å¬å™¨æ¯”è¾ƒç‰¹æ®Šï¼Œ**ä¸éœ€è¦é…ç½®**ï¼Œåªè¦å¯¹è±¡å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå½“å¯¹è±¡è¢«æ”¾å…¥æˆ–ç§»å‡ºSessionæ—¶å°±ä¼šè‡ªåŠ¨è°ƒç”¨ï¼š

```java
// ç”¨æˆ·åœ¨çº¿çŠ¶æ€ç›‘å¬
public class OnlineUser implements HttpSessionBindingListener, Serializable {
    private String username;
    private Date loginTime;
    
    public OnlineUser(String username) {
        this.username = username;
        this.loginTime = new Date();
    }
    
    // å¯¹è±¡ç»‘å®šåˆ°Sessionæ—¶è°ƒç”¨
    @Override
    public void valueBound(HttpSessionBindingEvent event) {
        System.out.println("ç”¨æˆ· " + username + " ä¸Šçº¿äº†");
        
        // å¯ä»¥åœ¨è¿™é‡Œè®°å½•ç”¨æˆ·ä¸Šçº¿ä¿¡æ¯
        logUserOnline();
    }
    
    // å¯¹è±¡ä»Sessionç§»é™¤æ—¶è°ƒç”¨  
    @Override
    public void valueUnbound(HttpSessionBindingEvent event) {
        System.out.println("ç”¨æˆ· " + username + " ä¸‹çº¿äº†");
        
        // è®°å½•ç”¨æˆ·ä¸‹çº¿ä¿¡æ¯
        logUserOffline();
    }
    
    private void logUserOnline() {
        // è®°å½•åˆ°æ•°æ®åº“æˆ–æ—¥å¿—æ–‡ä»¶
        System.out.println("è®°å½•ç”¨æˆ·ä¸Šçº¿ï¼š" + username + " at " + loginTime);
    }
    
    private void logUserOffline() {
        // è®°å½•ç”¨æˆ·ä¸‹çº¿æ—¶é—´
        System.out.println("è®°å½•ç”¨æˆ·ä¸‹çº¿ï¼š" + username + " at " + new Date());
    }
}

// ä½¿ç”¨æ–¹å¼ï¼š
// session.setAttribute("user", new OnlineUser("å¼ ä¸‰"));  // è‡ªåŠ¨è°ƒç”¨valueBound
// session.removeAttribute("user");  // è‡ªåŠ¨è°ƒç”¨valueUnbound
```

---

## 6. ğŸ’¼ å®é™…é¡¹ç›®åº”ç”¨åœºæ™¯


### 6.1 å®Œæ•´çš„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ


**ğŸ›¡ï¸ å¤šå±‚è¿‡æ»¤å™¨æƒé™æ§åˆ¶**

```java
// 1. åŸºç¡€è®¤è¯è¿‡æ»¤å™¨
@WebFilter(urlPatterns = {"/admin/*", "/user/*"}, filterName = "AuthFilter")
public class AuthenticationFilter implements Filter {
    
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // æ£€æŸ¥æ˜¯å¦ç™»å½•
        Object user = req.getSession().getAttribute("currentUser");
        if (user == null) {
            resp.sendRedirect(req.getContextPath() + "/login.jsp");
            return;
        }
        
        // å·²ç™»å½•ï¼Œç»§ç»­æ‰§è¡Œ
        chain.doFilter(request, response);
    }
}

// 2. ç®¡ç†å‘˜æƒé™è¿‡æ»¤å™¨
@WebFilter(urlPatterns = "/admin/*", filterName = "AdminFilter")
public class AdminAuthFilter implements Filter {
    
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // è·å–å½“å‰ç”¨æˆ·
        User user = (User) req.getSession().getAttribute("currentUser");
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜
        if (user == null || !"admin".equals(user.getRole())) {
            resp.sendError(HttpServletResponse.SC_FORBIDDEN, "éœ€è¦ç®¡ç†å‘˜æƒé™");
            return;
        }
        
        chain.doFilter(request, response);
    }
}
```

### 6.2 ç³»ç»Ÿç›‘æ§ä¸ç»Ÿè®¡


**ğŸ“Š åº”ç”¨æ€§èƒ½ç›‘æ§ç³»ç»Ÿ**

```java
@WebListener
public class SystemMonitorListener implements ServletContextListener, 
                                             HttpSessionListener, 
                                             ServletRequestListener {
    
    // ç³»ç»Ÿå¯åŠ¨æ—¶åˆå§‹åŒ–ç›‘æ§
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext context = sce.getServletContext();
        
        // åˆå§‹åŒ–ç»Ÿè®¡æ•°æ®
        context.setAttribute("totalRequests", 0L);
        context.setAttribute("onlineUsers", 0);
        context.setAttribute("systemStartTime", new Date());
        
        System.out.println("ç³»ç»Ÿç›‘æ§å¯åŠ¨å®Œæˆ");
    }
    
    // ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        ServletContext context = se.getSession().getServletContext();
        Integer online = (Integer) context.getAttribute("onlineUsers");
        context.setAttribute("onlineUsers", online + 1);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        ServletContext context = se.getSession().getServletContext();
        Integer online = (Integer) context.getAttribute("onlineUsers");
        context.setAttribute("onlineUsers", Math.max(0, online - 1));
    }
    
    // ç»Ÿè®¡è¯·æ±‚æ¬¡æ•°
    @Override
    public void requestInitialized(ServletRequestEvent sre) {
        ServletContext context = sre.getServletContext();
        Long total = (Long) context.getAttribute("totalRequests");
        context.setAttribute("totalRequests", total + 1);
    }
    
    @Override
    public void requestDestroyed(ServletRequestEvent sre) {
        // å¯ä»¥åœ¨è¿™é‡Œè®°å½•è¯·æ±‚å®Œæˆä¿¡æ¯
    }
}
```

### 6.3 æ—¥å¿—è®°å½•ä¸å®¡è®¡


**ğŸ“ æ“ä½œæ—¥å¿—è®°å½•ç³»ç»Ÿ**

```java
@WebFilter("/*")
public class AuditLogFilter implements Filter {
    
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // è®°å½•è¯·æ±‚ä¿¡æ¯
        String uri = req.getRequestURI();
        String method = req.getMethod();
        String userIP = getClientIP(req);
        Date requestTime = new Date();
        
        try {
            // ç»§ç»­æ‰§è¡Œè¯·æ±‚
            chain.doFilter(request, response);
            
            // è®°å½•æˆåŠŸæ—¥å¿—
            logOperation(uri, method, userIP, requestTime, resp.getStatus(), "SUCCESS");
            
        } catch (Exception e) {
            // è®°å½•å¼‚å¸¸æ—¥å¿—
            logOperation(uri, method, userIP, requestTime, 500, "ERROR: " + e.getMessage());
            throw e;
        }
    }
    
    private void logOperation(String uri, String method, String ip, 
                             Date time, int status, String result) {
        // ç®€åŒ–çš„æ—¥å¿—è®°å½•
        System.out.printf("[%s] %s %s from %s - Status: %d - %s%n", 
                         time, method, uri, ip, status, result);
    }
    
    private String getClientIP(HttpServletRequest request) {
        String ip = request.getHeader("X-Real-IP");
        if (ip == null || ip.length() == 0) {
            ip = request.getRemoteAddr();
        }
        return ip;
    }
}
```

### 6.4 ç¼“å­˜æ§åˆ¶ç³»ç»Ÿ


**ğŸš€ å“åº”ç¼“å­˜è¿‡æ»¤å™¨**

```java
@WebFilter(urlPatterns = {"*.css", "*.js", "*.png", "*.jpg", "*.gif"})
public class CacheControlFilter implements Filter {
    
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // è®¾ç½®ç¼“å­˜å¤´
        resp.setHeader("Cache-Control", "public, max-age=86400"); // 1å¤©
        resp.setHeader("Expires", getExpireDate());
        
        chain.doFilter(request, response);
    }
    
    private String getExpireDate() {
        // è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º1å¤©å
        Date expireDate = new Date(System.currentTimeMillis() + 86400000);
        SimpleDateFormat sdf = new SimpleDateFormat("EEE, dd MMM yyyy HH:mm:ss z", Locale.US);
        sdf.setTimeZone(TimeZone.getTimeZone("GMT"));
        return sdf.format(expireDate);
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¿‡æ»¤å™¨æœ¬è´¨ï¼šWebåº”ç”¨çš„"é—¨å«"ï¼Œè´Ÿè´£è¯·æ±‚å’Œå“åº”çš„é¢„å¤„ç†å’Œåå¤„ç†
ğŸ”¸ Filteræ¥å£ï¼šinit()åˆå§‹åŒ–ã€doFilter()æ ¸å¿ƒé€»è¾‘ã€destroy()æ¸…ç†èµ„æº
ğŸ”¸ è¿‡æ»¤å™¨é“¾ï¼šFilterChainè´Ÿè´£ä¸²è”å¤šä¸ªè¿‡æ»¤å™¨ï¼Œå½¢æˆå¤„ç†æµæ°´çº¿
ğŸ”¸ ç›‘å¬å™¨æœ¬è´¨ï¼šWebåº”ç”¨çš„"è§‚å¯Ÿå‘˜"ï¼Œç›‘å¬ç‰¹å®šäº‹ä»¶å¹¶è‡ªåŠ¨å“åº”
ğŸ”¸ äº‹ä»¶é©±åŠ¨ï¼šç›‘å¬å™¨åŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œè¢«åŠ¨å“åº”äº‹ä»¶å‘ç”Ÿ
ğŸ”¸ æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼šè·¨è¶Šå¤šä¸ªåŠŸèƒ½æ¨¡å—çš„é€šç”¨éœ€æ±‚ï¼Œå¦‚å®‰å…¨ã€æ—¥å¿—ã€æ€§èƒ½ç›‘æ§
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¿‡æ»¤å™¨å·¥ä½œåŸç†**
```
è¯·æ±‚æµå‘ï¼šå®¢æˆ·ç«¯ â†’ Filter1 â†’ Filter2 â†’ Servlet â†’ Filter2 â†’ Filter1 â†’ å®¢æˆ·ç«¯
æ ¸å¿ƒè¦ç‚¹ï¼š
- chain.doFilter()å‰å¤„ç†è¯·æ±‚ï¼Œåå¤„ç†å“åº”
- ä¸è°ƒç”¨chain.doFilter()ä¼šä¸­æ–­è¯·æ±‚é“¾
- å“åº”å¤„ç†é¡ºåºä¸è¯·æ±‚å¤„ç†é¡ºåºç›¸å
```

**ğŸ”¹ ç›‘å¬å™¨åˆ†ç±»è®°å¿†**
```
ç”Ÿå‘½å‘¨æœŸç›‘å¬ï¼šå¯¹è±¡çš„ç”Ÿè€ç—…æ­»ï¼ˆåˆ›å»ºã€é”€æ¯ï¼‰
å±æ€§ç›‘å¬ï¼šå¯¹è±¡å±æ€§çš„å¢åˆ æ”¹ï¼ˆæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰
ç»‘å®šç›‘å¬ï¼šå¯¹è±¡ä¸Sessionçš„ç»‘å®šå…³ç³»ï¼ˆç»‘å®šã€è§£ç»‘ï¼‰
```

**ğŸ”¹ é…ç½®æ–¹å¼é€‰æ‹©**
```
æ³¨è§£é…ç½®ï¼š@WebFilterã€@WebListenerï¼ˆæ¨èï¼Œç®€å•ç›´æ¥ï¼‰
XMLé…ç½®ï¼šweb.xmlï¼ˆä¼ ç»Ÿæ–¹å¼ï¼Œå¤æ‚é¡¹ç›®ä¸­ä¾¿äºç»Ÿä¸€ç®¡ç†ï¼‰
æ··åˆé…ç½®ï¼šXMLä¼˜å…ˆçº§é«˜äºæ³¨è§£
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¼ä¸šé¡¹ç›®å¿…å¤‡åŠŸèƒ½**

- **å®‰å…¨æ§åˆ¶**ï¼šç™»å½•éªŒè¯ã€æƒé™æ£€æŸ¥ã€é˜²æ”»å‡»
- **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜æ§åˆ¶ã€å“åº”å‹ç¼©ã€é™æ€èµ„æºå¤„ç†
- **ç³»ç»Ÿç›‘æ§**ï¼šè¯·æ±‚ç»Ÿè®¡ã€æ€§èƒ½ç›‘æ§ã€å¼‚å¸¸è¿½è¸ª
- **æ—¥å¿—å®¡è®¡**ï¼šæ“ä½œè®°å½•ã€è®¿é—®æ—¥å¿—ã€å®‰å…¨å®¡è®¡

**ğŸ¯ å­¦ä¹ è¿›é˜¶å»ºè®®**

1. **åŸºç¡€æŒæ¡**ï¼šç†Ÿç»ƒä½¿ç”¨åŸºæœ¬çš„è¿‡æ»¤å™¨å’Œç›‘å¬å™¨
2. **ç»„åˆåº”ç”¨**ï¼šå­¦ä¼šç»„åˆå¤šä¸ªè¿‡æ»¤å™¨è§£å†³å¤æ‚é—®é¢˜
3. **æ€§èƒ½è€ƒè™‘**ï¼šç†è§£è¿‡æ»¤å™¨å¯¹æ€§èƒ½çš„å½±å“
4. **æ¡†æ¶æ•´åˆ**ï¼šäº†è§£Springç­‰æ¡†æ¶ä¸­çš„è¿‡æ»¤å™¨åº”ç”¨

### 7.4 å¸¸è§å¼€å‘é™·é˜±


**âš ï¸ æ–°æ‰‹æ˜“çŠ¯é”™è¯¯**

```
å¿˜è®°è°ƒç”¨chain.doFilter() â†’ è¯·æ±‚è¢«æ‹¦æˆªï¼Œæ— æ³•åˆ°è¾¾ç›®æ ‡èµ„æº
è¿‡æ»¤å™¨é¡ºåºæ··ä¹± â†’ åŠŸèƒ½å¼‚å¸¸ï¼Œå¦‚ç¼–ç è¿‡æ»¤å™¨åœ¨æƒé™è¿‡æ»¤å™¨ä¹‹å
ç›‘å¬å™¨é…ç½®é—æ¼ â†’ äº‹ä»¶æ— æ³•è¢«ç›‘å¬ï¼ŒåŠŸèƒ½å¤±æ•ˆ
èµ„æºæ¸…ç†ä¸å½“ â†’ å†…å­˜æ³„æ¼ï¼Œç³»ç»Ÿæ€§èƒ½ä¸‹é™
```

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**

```
è®¾è®¡åŸåˆ™ï¼š
- å•ä¸€èŒè´£ï¼šæ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£ä¸€é¡¹åŠŸèƒ½
- é“¾å¼è®¾è®¡ï¼šåˆç†è§„åˆ’è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº
- å¼‚å¸¸å¤„ç†ï¼šåšå¥½å¼‚å¸¸æ•è·å’Œå¤„ç†
- èµ„æºç®¡ç†ï¼šåŠæ—¶é‡Šæ”¾å ç”¨çš„èµ„æº

æ€§èƒ½ä¼˜åŒ–ï¼š
- é¿å…é‡å¤å¤„ç†ï¼šç›¸åŒé€»è¾‘ä¸è¦åœ¨å¤šä¸ªè¿‡æ»¤å™¨ä¸­é‡å¤
- æ¡ä»¶åˆ¤æ–­ï¼šå…ˆè¿›è¡Œè½»é‡çº§åˆ¤æ–­ï¼Œå†æ‰§è¡Œé‡é‡çº§æ“ä½œ
- ç¼“å­˜åˆ©ç”¨ï¼šåˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
```

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**

> **è¿‡æ»¤å™¨åƒé—¨å«**ï¼šç«™åœ¨é—¨å£æ£€æŸ¥æ¯ä¸ªè¿›å‡ºçš„äºº
> **ç›‘å¬å™¨åƒä¿å®‰**ï¼šåœ¨å„ä¸ªå…³é”®ä½ç½®è§‚å¯Ÿæƒ…å†µ
> **è¿‡æ»¤å™¨é“¾åƒæµæ°´çº¿**ï¼šæ¯ä¸ªç¯èŠ‚å¤„ç†ç‰¹å®šä»»åŠ¡
> **æ¨ªåˆ‡å…³æ³¨ç‚¹åƒç®¡é“**ï¼šè´¯ç©¿æ•´ä¸ªç³»ç»Ÿçš„é€šç”¨éœ€æ±‚

**è®°å¿†å£è¯€**ï¼š
```
è¿‡æ»¤å™¨é—¨å«ç«™é—¨å£ï¼Œè¯·æ±‚å“åº”éƒ½è¦èµ°
ç›‘å¬å™¨ä¿å®‰å››å¤„çœ‹ï¼Œäº‹ä»¶å‘ç”Ÿç«‹å³åŠ
è¿‡æ»¤å™¨é“¾åƒæµæ°´çº¿ï¼Œé¡ºåºæ‰§è¡Œä¸èƒ½ä¹±
æ¨ªåˆ‡å…³æ³¨è´¯å…¨å±€ï¼Œå®‰å…¨æ—¥å¿—æ€§èƒ½æŠ“
```