---
title: 2ã€Filter-ç”Ÿå‘½å‘¨æœŸè¯¦è§£
---
## ğŸ“š ç›®å½•

1. [Filterç”Ÿå‘½å‘¨æœŸæ¦‚è¿°](#1-Filterç”Ÿå‘½å‘¨æœŸæ¦‚è¿°)
2. [init()åˆå§‹åŒ–æ–¹æ³•è¯¦è§£](#2-initåˆå§‹åŒ–æ–¹æ³•è¯¦è§£)
3. [doFilter()æ ¸å¿ƒæ‰§è¡Œæ–¹æ³•](#3-doFilteræ ¸å¿ƒæ‰§è¡Œæ–¹æ³•)
4. [destroy()é”€æ¯æ–¹æ³•](#4-destroyé”€æ¯æ–¹æ³•)
5. [å®¹å™¨ç®¡ç†æœºåˆ¶](#5-å®¹å™¨ç®¡ç†æœºåˆ¶)
6. [å•ä¾‹ç‰¹æ€§ä¸çº¿ç¨‹å®‰å…¨](#6-å•ä¾‹ç‰¹æ€§ä¸çº¿ç¨‹å®‰å…¨)
7. [å®ä¾‹åŒ–æ—¶æœºåˆ†æ](#7-å®ä¾‹åŒ–æ—¶æœºåˆ†æ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ Filterç”Ÿå‘½å‘¨æœŸæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Filterç”Ÿå‘½å‘¨æœŸ


> **ç®€å•ç†è§£**ï¼šFilterç”Ÿå‘½å‘¨æœŸå°±åƒä¸€ä¸ªå‘˜å·¥åœ¨å…¬å¸çš„å·¥ä½œå†ç¨‹ - å…¥èŒåŸ¹è®­ã€æ­£å¼å·¥ä½œã€é€€ä¼‘ç¦»èŒ

**ç”Ÿå‘½å‘¨æœŸä¸‰ä¸ªé˜¶æ®µ**ï¼š
```
ğŸš€ è¯ç”Ÿé˜¶æ®µï¼šinit()æ–¹æ³•     â†’ å‘˜å·¥å…¥èŒåŸ¹è®­
âš¡ å·¥ä½œé˜¶æ®µï¼šdoFilter()æ–¹æ³•  â†’ å‘˜å·¥æ—¥å¸¸å·¥ä½œ  
ğŸ ç»“æŸé˜¶æ®µï¼šdestroy()æ–¹æ³•   â†’ å‘˜å·¥é€€ä¼‘ç¦»èŒ
```

### 1.2 ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾


```
Webåº”ç”¨å¯åŠ¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºFilterå®ä¾‹  â”‚ â† å®¹å™¨è‡ªåŠ¨åˆ›å»ºï¼ˆåªåˆ›å»ºä¸€æ¬¡ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è°ƒç”¨init()æ–¹æ³•  â”‚ â† åˆå§‹åŒ–é…ç½®ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â† æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰§è¡Œ
â”‚ è°ƒç”¨doFilter()  â”‚ âŸ· å¤„ç†HTTPè¯·æ±‚/å“åº”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒç”¨destroy()   â”‚ â† Webåº”ç”¨å…³é—­æ—¶æ‰§è¡Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Filterå®ä¾‹é”€æ¯
```

### 1.3 æ ¸å¿ƒç‰¹ç‚¹ç†è§£


| ç‰¹ç‚¹ | **è¯´æ˜** | **ç±»æ¯”ç†è§£** |
|------|---------|-------------|
| **å•ä¾‹æ€§** | `æ•´ä¸ªåº”ç”¨ä¸­Filteråªæœ‰ä¸€ä¸ªå®ä¾‹` | `å…¬å¸åªæœ‰ä¸€ä¸ªå‰å°æ¥å¾…å‘˜` |
| **å®¹å™¨ç®¡ç†** | `ç”±Servletå®¹å™¨è´Ÿè´£åˆ›å»ºå’Œç®¡ç†` | `å‘˜å·¥ç”±HRéƒ¨é—¨ç»Ÿä¸€ç®¡ç†` |
| **è‡ªåŠ¨è°ƒç”¨** | `ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç”±å®¹å™¨è‡ªåŠ¨è°ƒç”¨` | `ä¸Šä¸‹ç­æ—¶é—´ç”±å…¬å¸åˆ¶åº¦å†³å®š` |

---

## 2. ğŸš€ init()åˆå§‹åŒ–æ–¹æ³•è¯¦è§£


### 2.1 init()æ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ æ ¸å¿ƒåŠŸèƒ½**
```
init()æ–¹æ³• = Filterçš„"æ–°å‘˜å·¥åŸ¹è®­"
â€¢ è¯»å–é…ç½®å‚æ•°
â€¢ åˆå§‹åŒ–èµ„æºè¿æ¥  
â€¢ è®¾ç½®è¿‡æ»¤è§„åˆ™
â€¢ å‡†å¤‡å·¥ä½œç¯å¢ƒ
```

### 2.2 æ–¹æ³•ç­¾åä¸å‚æ•°


```java
public void init(FilterConfig filterConfig) throws ServletException
```

**å‚æ•°è§£é‡Š**ï¼š
- `FilterConfig filterConfig`ï¼š**é…ç½®ä¿¡æ¯å¯¹è±¡**ï¼ŒåŒ…å«Filterçš„æ‰€æœ‰é…ç½®å‚æ•°

### 2.3 å®é™…åº”ç”¨ç¤ºä¾‹


```java
public class MyFilter implements Filter {
    private String encoding;        // å­—ç¬¦ç¼–ç 
    private boolean debugMode;      // è°ƒè¯•æ¨¡å¼
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // ğŸ”¸ è¯»å–web.xmlä¸­çš„é…ç½®å‚æ•°
        encoding = filterConfig.getInitParameter("encoding");
        if (encoding == null) {
            encoding = "UTF-8";  // è®¾ç½®é»˜è®¤å€¼
        }
        
        // ğŸ”¸ è¯»å–è°ƒè¯•æ¨¡å¼é…ç½®
        String debug = filterConfig.getInitParameter("debug");
        debugMode = "true".equals(debug);
        
        // ğŸ”¸ æ‰“å°åˆå§‹åŒ–ä¿¡æ¯
        System.out.println("è¿‡æ»¤å™¨åˆå§‹åŒ–å®Œæˆ - ç¼–ç ï¼š" + encoding);
    }
}
```

**å¯¹åº”çš„web.xmlé…ç½®**ï¼š
```xml
<filter>
    <filter-name>MyFilter</filter-name>
    <filter-class>com.example.MyFilter</filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
    <init-param>
        <param-name>debug</param-name>
        <param-value>true</param-value>
    </init-param>
</filter>
```

### 2.4 init()æ–¹æ³•çš„ç‰¹ç‚¹


> **âš ï¸ é‡è¦æé†’**ï¼šinit()æ–¹æ³•åªä¼šåœ¨Filterå®ä¾‹åˆ›å»ºæ—¶è°ƒç”¨**ä¸€æ¬¡**ï¼Œå°±åƒå‘˜å·¥åªéœ€è¦å…¥èŒåŸ¹è®­ä¸€æ¬¡

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… **å•æ¬¡æ‰§è¡Œ**ï¼šæ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…åªè°ƒç”¨ä¸€æ¬¡
- âœ… **å®¹å™¨è°ƒç”¨**ï¼šç”±Servletå®¹å™¨è‡ªåŠ¨è°ƒç”¨ï¼Œæ— éœ€æ‰‹åŠ¨æ‰§è¡Œ
- âœ… **é…ç½®è·å–**ï¼šé€šè¿‡FilterConfigè·å–åˆå§‹åŒ–å‚æ•°
- âœ… **å¼‚å¸¸å¤„ç†**ï¼šå¯ä»¥æŠ›å‡ºServletExceptionç»ˆæ­¢åˆå§‹åŒ–

---

## 3. âš¡ doFilter()æ ¸å¿ƒæ‰§è¡Œæ–¹æ³•


### 3.1 doFilter()æ–¹æ³•æ¦‚è¿°


**ğŸ”¸ æ ¸å¿ƒç†è§£**
```
doFilter() = Filterçš„"æ—¥å¸¸å·¥ä½œ"
æ¯ä¸ªHTTPè¯·æ±‚éƒ½ä¼šç»è¿‡è¿™é‡Œå¤„ç†
```

### 3.2 æ–¹æ³•ç­¾åè¯¦è§£


```java
public void doFilter(ServletRequest request, ServletResponse response, 
                    FilterChain chain) throws IOException, ServletException
```

**å‚æ•°è¯´æ˜**ï¼š
- `ServletRequest request`ï¼š**è¯·æ±‚å¯¹è±¡** - åŒ…å«å®¢æˆ·ç«¯å‘é€çš„æ‰€æœ‰ä¿¡æ¯
- `ServletResponse response`ï¼š**å“åº”å¯¹è±¡** - ç”¨äºå‘å®¢æˆ·ç«¯å‘é€å“åº”
- `FilterChain chain`ï¼š**è¿‡æ»¤å™¨é“¾** - ç”¨äºä¼ é€’è¯·æ±‚ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–ç›®æ ‡èµ„æº

### 3.3 è¿‡æ»¤å™¨é“¾å·¥ä½œåŸç†


```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ Filter1 â†’ Filter2 â†’ Filter3 â†’ Servlet â†’ å“åº”è¿”å›
             â†“        â†“        â†“         â†“
         doFilter  doFilter  doFilter  service
             â†‘        â†‘        â†‘         â†‘
           å¤„ç†è¯·æ±‚   å¤„ç†è¯·æ±‚   å¤„ç†è¯·æ±‚   ä¸šåŠ¡é€»è¾‘
             â†“        â†“        â†“         â†“
           å¤„ç†å“åº”   å¤„ç†å“åº”   å¤„ç†å“åº”   è¿”å›ç»“æœ
```

### 3.4 å®é™…åº”ç”¨ç¤ºä¾‹


```java
@Override
public void doFilter(ServletRequest request, ServletResponse response, 
                    FilterChain chain) throws IOException, ServletException {
    
    // ğŸ”¸ è¯·æ±‚é¢„å¤„ç†ï¼ˆåœ¨è¯·æ±‚åˆ°è¾¾Servletä¹‹å‰ï¼‰
    HttpServletRequest httpRequest = (HttpServletRequest) request;
    HttpServletResponse httpResponse = (HttpServletResponse) response;
    
    // è®¾ç½®å­—ç¬¦ç¼–ç 
    httpRequest.setCharacterEncoding(encoding);
    httpResponse.setCharacterEncoding(encoding);
    
    // è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
    long startTime = System.currentTimeMillis();
    
    System.out.println("è¯·æ±‚å¼€å§‹ï¼š" + httpRequest.getRequestURI());
    
    // ğŸ”¸ ç»§ç»­æ‰§è¡Œè¿‡æ»¤å™¨é“¾ï¼ˆå…³é”®æ­¥éª¤ï¼ï¼‰
    chain.doFilter(request, response);
    
    // ğŸ”¸ å“åº”åå¤„ç†ï¼ˆåœ¨å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹å‰ï¼‰
    long endTime = System.currentTimeMillis();
    System.out.println("è¯·æ±‚ç»“æŸï¼Œè€—æ—¶ï¼š" + (endTime - startTime) + "ms");
}
```

### 3.5 FilterChain.doFilter()çš„é‡è¦æ€§


> **ğŸš¨ æ ¸å¿ƒé‡ç‚¹**ï¼š`chain.doFilter(request, response)` æ˜¯è¿‡æ»¤å™¨çš„**çµé­‚**

**ç†è§£è¦ç‚¹**ï¼š
- **è°ƒç”¨å‰**ï¼šå¯¹è¯·æ±‚è¿›è¡Œé¢„å¤„ç†
- **è°ƒç”¨æ—¶**ï¼šå°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–Servlet
- **è°ƒç”¨å**ï¼šå¯¹å“åº”è¿›è¡Œåå¤„ç†

**å¦‚æœä¸è°ƒç”¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**
```java
// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå¿˜è®°è°ƒç”¨chain.doFilter()
public void doFilter(ServletRequest request, ServletResponse response, 
                    FilterChain chain) throws IOException, ServletException {
    System.out.println("å¤„ç†è¯·æ±‚");
    // å¿˜è®°è°ƒç”¨ chain.doFilter(request, response);
    // ç»“æœï¼šè¯·æ±‚åˆ°æ­¤ä¸ºæ­¢ï¼Œæ— æ³•ç»§ç»­ä¼ é€’ï¼
}
```

---

## 4. ğŸ destroy()é”€æ¯æ–¹æ³•


### 4.1 destroy()æ–¹æ³•ä½œç”¨


**ğŸ”¸ æ ¸å¿ƒåŠŸèƒ½**
```
destroy() = Filterçš„"é€€ä¼‘ç¦»èŒ"
â€¢ æ¸…ç†å ç”¨çš„èµ„æº
â€¢ å…³é—­æ•°æ®åº“è¿æ¥
â€¢ ä¿å­˜é‡è¦æ•°æ®
â€¢ ä¼˜é›…é€€å‡º
```

### 4.2 æ–¹æ³•ç­¾å


```java
public void destroy()
```

**ç‰¹ç‚¹**ï¼š
- æ— å‚æ•°ï¼Œæ— è¿”å›å€¼
- ä¸æŠ›å‡ºå¼‚å¸¸
- ç”±å®¹å™¨è‡ªåŠ¨è°ƒç”¨

### 4.3 å®é™…åº”ç”¨ç¤ºä¾‹


```java
public class ResourceFilter implements Filter {
    private DataSource dataSource;
    private FileWriter logWriter;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // åˆå§‹åŒ–èµ„æº
        dataSource = createDataSource();
        try {
            logWriter = new FileWriter("filter.log", true);
        } catch (IOException e) {
            throw new ServletException("æ— æ³•åˆ›å»ºæ—¥å¿—æ–‡ä»¶", e);
        }
    }
    
    @Override
    public void destroy() {
        // ğŸ”¸ æ¸…ç†èµ„æº
        if (dataSource != null) {
            closeDataSource(dataSource);
            System.out.println("æ•°æ®æºå·²å…³é—­");
        }
        
        // ğŸ”¸ å…³é—­æ–‡ä»¶æµ
        if (logWriter != null) {
            try {
                logWriter.close();
                System.out.println("æ—¥å¿—æ–‡ä»¶å·²å…³é—­");
            } catch (IOException e) {
                System.err.println("å…³é—­æ—¥å¿—æ–‡ä»¶å¤±è´¥ï¼š" + e.getMessage());
            }
        }
        
        System.out.println("è¿‡æ»¤å™¨èµ„æºæ¸…ç†å®Œæˆ");
    }
}
```

### 4.4 destroy()è°ƒç”¨æ—¶æœº


**è§¦å‘æƒ…å†µ**ï¼š
- âœ… Webåº”ç”¨æ­£å¸¸å…³é—­
- âœ… æœåŠ¡å™¨æ­£å¸¸åœæ­¢
- âœ… Webåº”ç”¨é‡æ–°éƒ¨ç½²
- âœ… Filteré…ç½®å‘ç”Ÿå˜åŒ–

---

## 5. ğŸ¢ å®¹å™¨ç®¡ç†æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯å®¹å™¨ç®¡ç†


> **é€šä¿—ç†è§£**ï¼šServletå®¹å™¨å°±åƒä¸€ä¸ª**æ™ºèƒ½ç®¡å®¶**ï¼Œè´Ÿè´£Filterçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ

**å®¹å™¨çš„èŒè´£**ï¼š
```
ğŸ“‹ åˆ›å»ºç®¡ç†ï¼šæ ¹æ®é…ç½®åˆ›å»ºFilterå®ä¾‹
ğŸ”§ ç”Ÿå‘½å‘¨æœŸï¼šç®¡ç†initã€doFilterã€destroyè°ƒç”¨
ğŸ“Š èµ„æºåˆ†é…ï¼šåˆ†é…å†…å­˜å’Œç³»ç»Ÿèµ„æº
ğŸ›¡ï¸ å®‰å…¨æ§åˆ¶ï¼šç®¡ç†è®¿é—®æƒé™å’Œå®‰å…¨ç­–ç•¥
```

### 5.2 å®¹å™¨ç®¡ç†æµç¨‹


```
Webåº”ç”¨éƒ¨ç½²
    â†“
å®¹å™¨è¯»å–web.xmlé…ç½®
    â†“
åˆ›å»ºFilterå®ä¾‹ (new MyFilter())
    â†“
è°ƒç”¨init()æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–
    â†“
è¯·æ±‚åˆ°æ¥æ—¶è°ƒç”¨doFilter()
    â†“
åº”ç”¨å¸è½½æ—¶è°ƒç”¨destroy()
    â†“
å›æ”¶Filterå®ä¾‹å†…å­˜
```

### 5.3 å®¹å™¨vsç¨‹åºå‘˜çš„èŒè´£


| èŒè´£ | **å®¹å™¨è´Ÿè´£** | **ç¨‹åºå‘˜è´Ÿè´£** |
|------|-------------|---------------|
| **å®ä¾‹åˆ›å»º** | `âœ… è‡ªåŠ¨åˆ›å»ºFilterå¯¹è±¡` | `âŒ ä¸èƒ½æ‰‹åŠ¨new Filter` |
| **æ–¹æ³•è°ƒç”¨** | `âœ… è‡ªåŠ¨è°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•` | `âŒ ä¸èƒ½æ‰‹åŠ¨è°ƒç”¨init/destroy` |
| **é…ç½®è¯»å–** | `âœ… è§£æweb.xmlé…ç½®` | `âœ… ç¼–å†™Filterå®ç°ç±»` |
| **å†…å­˜ç®¡ç†** | `âœ… è‡ªåŠ¨åƒåœ¾å›æ”¶` | `âœ… åœ¨destroy()ä¸­æ¸…ç†èµ„æº` |

---

## 6. ğŸ‘¥ å•ä¾‹ç‰¹æ€§ä¸çº¿ç¨‹å®‰å…¨


### 6.1 Filterçš„å•ä¾‹ç‰¹æ€§


**ğŸ”¸ æ ¸å¿ƒç†è§£**
```
ä¸€ä¸ªFilteré…ç½® = ä¸€ä¸ªFilterå®ä¾‹
æ— è®ºæœ‰å¤šå°‘ä¸ªè¯·æ±‚ï¼Œéƒ½å…±äº«åŒä¸€ä¸ªFilterå¯¹è±¡
```

**å•ä¾‹ç¤ºæ„å›¾**ï¼š
```
è¯·æ±‚1 â”€â”€â”
è¯·æ±‚2 â”€â”€â”¤â”€â”€â†’ åŒä¸€ä¸ªFilterå®ä¾‹ â”€â”€â†’ doFilter()æ–¹æ³•
è¯·æ±‚3 â”€â”€â”˜
```

### 6.2 çº¿ç¨‹å®‰å…¨é—®é¢˜


**âš ï¸ æ½œåœ¨é—®é¢˜**ï¼šå¤šä¸ªè¯·æ±‚åŒæ—¶è®¿é—®åŒä¸€ä¸ªFilterå®ä¾‹ï¼Œå¯èƒ½å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜

```java
// âŒ çº¿ç¨‹ä¸å®‰å…¨çš„ç¤ºä¾‹
public class UnsafeFilter implements Filter {
    private int requestCount = 0;  // å®ä¾‹å˜é‡ - å¤šçº¿ç¨‹å…±äº«ï¼
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        requestCount++;  // çº¿ç¨‹ä¸å®‰å…¨ï¼å¤šä¸ªè¯·æ±‚å¯èƒ½åŒæ—¶ä¿®æ”¹
        System.out.println("å½“å‰è¯·æ±‚æ•°ï¼š" + requestCount);
        
        chain.doFilter(request, response);
    }
}
```

### 6.3 çº¿ç¨‹å®‰å…¨è§£å†³æ–¹æ¡ˆ


**âœ… æ–¹æ¡ˆ1ï¼šé¿å…ä½¿ç”¨å®ä¾‹å˜é‡**
```java
public class SafeFilter implements Filter {
    // åªåœ¨init()ä¸­è®¾ç½®çš„é…ç½®å‚æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„
    private String encoding;
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // ä½¿ç”¨å±€éƒ¨å˜é‡ - æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å‰¯æœ¬
        long startTime = System.currentTimeMillis();
        
        chain.doFilter(request, response);
        
        long endTime = System.currentTimeMillis();
        System.out.println("è¯·æ±‚è€—æ—¶ï¼š" + (endTime - startTime) + "ms");
    }
}
```

**âœ… æ–¹æ¡ˆ2ï¼šä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»**
```java
public class ThreadSafeFilter implements Filter {
    // ä½¿ç”¨åŸå­ç±»ä¿è¯çº¿ç¨‹å®‰å…¨
    private final AtomicInteger requestCount = new AtomicInteger(0);
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        int count = requestCount.incrementAndGet();
        System.out.println("å½“å‰è¯·æ±‚æ•°ï¼š" + count);
        
        chain.doFilter(request, response);
    }
}
```

### 6.4 çº¿ç¨‹å®‰å…¨æœ€ä½³å®è·µ


> **ğŸ’¡ é»„é‡‘æ³•åˆ™**ï¼šFilterä¸­å°½é‡ä¸è¦ä½¿ç”¨å¯å˜çš„å®ä¾‹å˜é‡

**å®‰å…¨ä½¿ç”¨æŒ‡å—**ï¼š
- âœ… **åªè¯»é…ç½®**ï¼šinit()ä¸­è®¾ç½®åä¸å†ä¿®æ”¹çš„é…ç½®å‚æ•°
- âœ… **å±€éƒ¨å˜é‡**ï¼šåœ¨doFilter()æ–¹æ³•ä¸­ä½¿ç”¨å±€éƒ¨å˜é‡
- âœ… **çº¿ç¨‹å®‰å…¨ç±»**ï¼šä½¿ç”¨AtomicIntegerã€ConcurrentHashMapç­‰
- âŒ **å¯å˜å®ä¾‹å˜é‡**ï¼šé¿å…åœ¨å¤šä¸ªè¯·æ±‚é—´å…±äº«å¯å˜çŠ¶æ€

---

## 7. â° å®ä¾‹åŒ–æ—¶æœºåˆ†æ


### 7.1 Filteråˆ›å»ºæ—¶æœº


**ğŸ”¸ æ ‡å‡†æ—¶æœº**ï¼šWebåº”ç”¨å¯åŠ¨æ—¶åˆ›å»º

```
Tomcatå¯åŠ¨
    â†“
éƒ¨ç½²Webåº”ç”¨
    â†“
è¯»å–web.xmlé…ç½®
    â†“  
åˆ›å»ºæ‰€æœ‰Filterå®ä¾‹ â† è¿™é‡Œåˆ›å»ºï¼
    â†“
è°ƒç”¨æ‰€æœ‰Filterçš„init()æ–¹æ³•
    â†“
Webåº”ç”¨å‡†å¤‡å°±ç»ª
```

### 7.2 å»¶è¿ŸåŠ è½½é…ç½®


**æ³¨è§£æ–¹å¼é…ç½®å»¶è¿ŸåŠ è½½**ï¼š
```java
@WebFilter(
    filterName = "LazyFilter",
    urlPatterns = "/*",
    asyncSupported = true,
    initParams = {
        @WebInitParam(name = "lazy-init", value = "true")
    }
)
public class LazyFilter implements Filter {
    // Filterå®ç°
}
```

**web.xmlæ–¹å¼é…ç½®**ï¼š
```xml
<filter>
    <filter-name>LazyFilter</filter-name>
    <filter-class>com.example.LazyFilter</filter-class>
    <load-on-startup>false</load-on-startup>
</filter>
```

### 7.3 åˆ›å»ºé¡ºåºè§„åˆ™


**å¤šä¸ªFilterçš„åˆ›å»ºé¡ºåº**ï¼š

```
Filterå£°æ˜é¡ºåºï¼ˆweb.xmlä¸­ï¼‰ï¼š
<filter>...</filter>  â† Filter A (ç¬¬1ä¸ªåˆ›å»º)
<filter>...</filter>  â† Filter B (ç¬¬2ä¸ªåˆ›å»º)  
<filter>...</filter>  â† Filter C (ç¬¬3ä¸ªåˆ›å»º)

æ‰§è¡Œé¡ºåºä¹ŸæŒ‰å£°æ˜é¡ºåºï¼š
è¯·æ±‚ â†’ Filter A â†’ Filter B â†’ Filter C â†’ Servlet
```

### 7.4 å®ä¾‹åŒ–å¼‚å¸¸å¤„ç†


**init()æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„åæœ**ï¼š
```java
@Override
public void init(FilterConfig filterConfig) throws ServletException {
    String required = filterConfig.getInitParameter("required-param");
    if (required == null) {
        throw new ServletException("ç¼ºå°‘å¿…éœ€çš„é…ç½®å‚æ•°");
        // Webåº”ç”¨å¯åŠ¨å¤±è´¥ï¼
    }
}
```

**å¼‚å¸¸å½±å“**ï¼š
- âŒ **åº”ç”¨å¯åŠ¨å¤±è´¥**ï¼šæ•´ä¸ªWebåº”ç”¨æ— æ³•æ­£å¸¸å¯åŠ¨
- âŒ **åç»­Filterä¸æ‰§è¡Œ**ï¼šå¼‚å¸¸Filterä¹‹åçš„Filterä¸ä¼šè¢«åˆ›å»º
- âŒ **æœåŠ¡ä¸å¯ç”¨**ï¼šç”¨æˆ·æ— æ³•è®¿é—®Webåº”ç”¨

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ”¸ ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼šinit() â†’ doFilter() â†’ destroy()
ğŸ”¸ å•ä¾‹ç‰¹æ€§ï¼šä¸€ä¸ªFilteré…ç½®å¯¹åº”ä¸€ä¸ªå®ä¾‹
ğŸ”¸ å®¹å™¨ç®¡ç†ï¼šç”±Servletå®¹å™¨è´Ÿè´£æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ
ğŸ”¸ çº¿ç¨‹å®‰å…¨ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦æ³¨æ„å…±äº«å˜é‡
ğŸ”¸ FilterChainï¼šchain.doFilter()æ˜¯è¯·æ±‚ä¼ é€’çš„å…³é”®
```

### 8.2 ç”Ÿå‘½å‘¨æœŸè®°å¿†å£è¯€


```
è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸï¼Œä¸‰æ­¥è¦è®°æ¸…ï¼š
initåˆå§‹åŒ–ï¼Œåªè°ƒç”¨ä¸€æ¬¡è¦é…ç½®
doFilterå¤„ç†ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ç»è¿‡
destroyé”€æ¯ï¼Œåº”ç”¨å…³é—­æ¥æ¸…ç†
```

### 8.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


| é—®é¢˜ | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|------|---------|-------------|
| **è¯·æ±‚æ— å“åº”** | `å¿˜è®°è°ƒç”¨chain.doFilter()` | `ç¡®ä¿è°ƒç”¨é“¾ä¼ é€’è¯·æ±‚` |
| **çº¿ç¨‹å®‰å…¨é—®é¢˜** | `ä½¿ç”¨å¯å˜å®ä¾‹å˜é‡` | `é¿å…å…±äº«çŠ¶æ€ï¼Œä½¿ç”¨å±€éƒ¨å˜é‡` |
| **åº”ç”¨å¯åŠ¨å¤±è´¥** | `init()æ–¹æ³•æŠ›å‡ºå¼‚å¸¸` | `å®Œå–„å¼‚å¸¸å¤„ç†å’Œå‚æ•°éªŒè¯` |
| **èµ„æºæ³„éœ²** | `destroy()æœªæ¸…ç†èµ„æº` | `åœ¨destroy()ä¸­é‡Šæ”¾æ‰€æœ‰èµ„æº` |

### 8.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ å¼€å‘æŒ‡å—**ï¼š
- âœ… **é…ç½®å‚æ•°**ï¼šåœ¨init()ä¸­è¯»å–å¹¶éªŒè¯é…ç½®å‚æ•°
- âœ… **è¯·æ±‚å¤„ç†**ï¼šdoFilter()ä¸­å…ˆå¤„ç†è¯·æ±‚ï¼Œå†è°ƒç”¨chain.doFilter()
- âœ… **å“åº”å¤„ç†**ï¼šchain.doFilter()åå¤„ç†å“åº”
- âœ… **èµ„æºç®¡ç†**ï¼šdestroy()ä¸­é‡Šæ”¾æ‰€æœ‰å ç”¨èµ„æº
- âœ… **çº¿ç¨‹å®‰å…¨**ï¼šé¿å…ä½¿ç”¨å¯å˜å®ä¾‹å˜é‡

**ğŸ” è°ƒè¯•æŠ€å·§**ï¼š
- åœ¨æ¯ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ·»åŠ æ—¥å¿—è¾“å‡º
- ä½¿ç”¨System.currentTimeMillis()æµ‹é‡è¯·æ±‚å¤„ç†æ—¶é—´
- è®°å½•Filterçš„åˆ›å»ºå’Œé”€æ¯æ—¶é—´
- ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

**æ ¸å¿ƒç†è§£**ï¼š
- Filterç”Ÿå‘½å‘¨æœŸæ˜¯å®¹å™¨ç®¡ç†çš„ï¼Œç¨‹åºå‘˜åªéœ€è¦å®ç°å…·ä½“é€»è¾‘
- å•ä¾‹ç‰¹æ€§è¦æ±‚æ³¨æ„çº¿ç¨‹å®‰å…¨ï¼Œé¿å…å…±äº«å¯å˜çŠ¶æ€
- FilterChainæ˜¯è¿‡æ»¤å™¨é“¾çš„æ ¸å¿ƒï¼Œå¿…é¡»æ­£ç¡®è°ƒç”¨
- èµ„æºç®¡ç†å¾ˆé‡è¦ï¼Œinit()ç”³è¯·çš„èµ„æºè¦åœ¨destroy()ä¸­é‡Šæ”¾