---
title: 3ã€Filter-æ ¸å¿ƒAPIä¸æ¥å£
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Filteræ ¸å¿ƒAPI](#1-ä»€ä¹ˆæ˜¯Filteræ ¸å¿ƒAPI)
2. [Filteræ¥å£è¯¦è§£](#2-Filteræ¥å£è¯¦è§£)
3. [FilterConfigé…ç½®ç¥å™¨](#3-FilterConfigé…ç½®ç¥å™¨)
4. [FilterChainè´£ä»»é“¾æ¨¡å¼](#4-FilterChainè´£ä»»é“¾æ¨¡å¼)
5. [Requestå’ŒResponseåŒ…è£…æŠ€å·§](#5-Requestå’ŒResponseåŒ…è£…æŠ€å·§)
6. [å‚æ•°è·å–ä¸ä¸Šä¸‹æ–‡è®¿é—®](#6-å‚æ•°è·å–ä¸ä¸Šä¸‹æ–‡è®¿é—®)
7. [å®æˆ˜æ¼”ç»ƒä¸æ€»ç»“](#7-å®æˆ˜æ¼”ç»ƒä¸æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯Filteræ ¸å¿ƒAPI


### 1.1 APIå…¨å®¶ç¦ä»‹ç»


æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å¼€äº†ä¸€å®¶é¤å…ï¼Œéœ€è¦ä¸åŒçš„"æ£€æŸ¥å‘˜"æ¥ç¡®ä¿æœåŠ¡è´¨é‡ï¼š

```
é¡¾å®¢è¿›é—¨æµç¨‹ï¼š
é¡¾å®¢ â†’ é—¨è¿æ£€æŸ¥ â†’ åº§ä½å®‰æ’ â†’ ç‚¹èœæœåŠ¡ â†’ ä¸Šèœæ£€æŸ¥ â†’ é¡¾å®¢ç”¨é¤

å¯¹åº”Filteræµç¨‹ï¼š
è¯·æ±‚ â†’ Filter1 â†’ Filter2 â†’ Servlet â†’ Filter2 â†’ Filter1 â†’ å“åº”
```

**ğŸ”¸ Filter APIæ ¸å¿ƒæˆå‘˜**

| ğŸ·ï¸ **APIæˆå‘˜** | ğŸ­ **è§’è‰²** | ğŸ’¡ **ä½œç”¨** |
|----------------|------------|-------------|
| **Filteræ¥å£** | `ä¸»æ¼”å‘˜` | å®šä¹‰è¿‡æ»¤å™¨çš„åŸºæœ¬è¡Œä¸º |
| **FilterConfig** | `é…ç½®ç®¡å®¶` | ç®¡ç†è¿‡æ»¤å™¨çš„é…ç½®ä¿¡æ¯ |
| **FilterChain** | `ä¼ é€’å‘˜` | è´Ÿè´£è¯·æ±‚åœ¨è¿‡æ»¤å™¨é—´ä¼ é€’ |
| **ServletRequeståŒ…è£…** | `è¯·æ±‚ç¾åŒ–å¸ˆ` | å¢å¼ºåŸå§‹è¯·æ±‚åŠŸèƒ½ |
| **ServletResponseåŒ…è£…** | `å“åº”ç¾åŒ–å¸ˆ` | å¢å¼ºåŸå§‹å“åº”åŠŸèƒ½ |

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›API


**ğŸ¤” æ²¡æœ‰è¿™äº›APIä¼šæ€æ ·ï¼Ÿ**

> å°±åƒé¤å…æ²¡æœ‰æœåŠ¡å‘˜æ ‡å‡†æµç¨‹ï¼Œæ¯ä¸ªæœåŠ¡å‘˜éƒ½æŒ‰è‡ªå·±çš„æƒ³æ³•æœåŠ¡ï¼Œç»“æœå¯æƒ³è€ŒçŸ¥ï¼

**âœ… æœ‰äº†è¿™äº›APIçš„å¥½å¤„ï¼š**
- **æ ‡å‡†åŒ–**ï¼šæ‰€æœ‰è¿‡æ»¤å™¨éƒ½éµå¾ªç›¸åŒè§„èŒƒ
- **å¯é…ç½®**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶çµæ´»è°ƒæ•´
- **å¯æ‰©å±•**ï¼šè½»æ¾æ·»åŠ æ–°çš„è¿‡æ»¤é€»è¾‘
- **è´£ä»»æ˜ç¡®**ï¼šæ¯ä¸ªç»„ä»¶èŒè´£æ¸…æ™°

---

## 2. ğŸ­ Filteræ¥å£è¯¦è§£


### 2.1 Filteræ¥å£ä¸‰å…„å¼Ÿ


Filteræ¥å£å°±åƒé¤å…æœåŠ¡å‘˜çš„å·¥ä½œæ‰‹å†Œï¼Œè§„å®šäº†ä¸‰ä¸ªå¿…é¡»ä¼šçš„æŠ€èƒ½ï¼š

```java
public interface Filter {
    // ğŸ”§ åˆå§‹åŒ–æ–¹æ³• - æœåŠ¡å‘˜å…¥èŒåŸ¹è®­
    void init(FilterConfig filterConfig) throws ServletException;
    
    // ğŸ¯ æ ¸å¿ƒæ–¹æ³• - æœåŠ¡å‘˜å®é™…å·¥ä½œ
    void doFilter(ServletRequest request, ServletResponse response, 
                  FilterChain chain) throws IOException, ServletException;
    
    // ğŸ é”€æ¯æ–¹æ³• - æœåŠ¡å‘˜ç¦»èŒæ”¶æ‹¾
    void destroy();
}
```

### 2.2 init()æ–¹æ³• - è¿‡æ»¤å™¨çš„"å…¥èŒåŸ¹è®­"


**ğŸ“ ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿ**
- æœåŠ¡å™¨å¯åŠ¨æ—¶
- ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿‡æ»¤å™¨å‰
- æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåªè°ƒç”¨ä¸€æ¬¡

**ğŸ’¼ ä¸»è¦ä»»åŠ¡ï¼š**

```java
public class MyFilter implements Filter {
    private String encoding;
    private boolean logEnabled;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // ğŸ“– è¯»å–é…ç½®å‚æ•°
        encoding = filterConfig.getInitParameter("encoding");
        String logFlag = filterConfig.getInitParameter("logEnabled");
        logEnabled = "true".equals(logFlag);
        
        // ğŸ”§ åˆå§‹åŒ–èµ„æº
        System.out.println("ğŸš€ MyFilteråˆå§‹åŒ–å®Œæˆï¼");
        System.out.println("ğŸ“ ç¼–ç æ ¼å¼ï¼š" + encoding);
        System.out.println("ğŸ“Š æ—¥å¿—å¼€å…³ï¼š" + logEnabled);
    }
}
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šinitæ–¹æ³•å°±åƒæ–°å‘˜å·¥åŸ¹è®­ï¼Œåœ¨è¿™é‡Œå‡†å¤‡å·¥ä½œæ‰€éœ€çš„ä¸€åˆ‡èµ„æºå’Œé…ç½®ï¼

### 2.3 doFilter()æ–¹æ³• - è¿‡æ»¤å™¨çš„"æ ¸å¿ƒå·¥ä½œ"


è¿™æ˜¯è¿‡æ»¤å™¨æœ€é‡è¦çš„æ–¹æ³•ï¼Œå°±åƒæœåŠ¡å‘˜æ¥å¾…æ¯ä½é¡¾å®¢çš„æ ‡å‡†æµç¨‹ï¼š

**ğŸ”„ æ‰§è¡Œæµç¨‹å›¾ç¤ºï¼š**

```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  doFilterå¼€å§‹   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è¯·æ±‚é¢„å¤„ç†   â”‚ â† å¯ä»¥ä¿®æ”¹è¯·æ±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. chain.doFilterâ”‚ â† ä¼ é€’ç»™ä¸‹ä¸€ä¸ª
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. å“åº”åå¤„ç†   â”‚ â† å¯ä»¥ä¿®æ”¹å“åº”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¿”å›å®¢æˆ·ç«¯
```

**ğŸ“ ç»å…¸å®ç°æ¨¡æ¿ï¼š**

```java
@Override
public void doFilter(ServletRequest request, ServletResponse response, 
                     FilterChain chain) throws IOException, ServletException {
    
    // ğŸ” ç¬¬ä¸€é˜¶æ®µï¼šè¯·æ±‚é¢„å¤„ç†
    System.out.println("ğŸ“¥ æ”¶åˆ°è¯·æ±‚ï¼š" + ((HttpServletRequest)request).getRequestURI());
    
    // â° è®°å½•å¼€å§‹æ—¶é—´
    long startTime = System.currentTimeMillis();
    
    // ğŸ¯ ç¬¬äºŒé˜¶æ®µï¼šä¼ é€’è¯·æ±‚ï¼ˆé‡è¦ï¼ï¼‰
    chain.doFilter(request, response);
    
    // âœ… ç¬¬ä¸‰é˜¶æ®µï¼šå“åº”åå¤„ç†
    long endTime = System.currentTimeMillis();
    System.out.println("ğŸ“¤ è¯·æ±‚å¤„ç†å®Œæˆï¼Œè€—æ—¶ï¼š" + (endTime - startTime) + "ms");
}
```

> âš ï¸ **é‡è¦æé†’**ï¼šä¸€å®šè¦è°ƒç”¨ `chain.doFilter(request, response)`ï¼Œå¦åˆ™è¯·æ±‚æ— æ³•ç»§ç»­ä¼ é€’ï¼

### 2.4 destroy()æ–¹æ³• - è¿‡æ»¤å™¨çš„"å–„åå·¥ä½œ"


**ğŸ§¹ ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿ**
- æœåŠ¡å™¨å…³é—­æ—¶
- åº”ç”¨é‡æ–°éƒ¨ç½²æ—¶
- æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåªè°ƒç”¨ä¸€æ¬¡

```java
@Override
public void destroy() {
    System.out.println("ğŸ”š MyFilteræ­£åœ¨é”€æ¯...");
    // ğŸ—‘ï¸ æ¸…ç†èµ„æºï¼Œå…³é—­è¿æ¥ç­‰
    encoding = null;
    System.out.println("âœ… MyFilteré”€æ¯å®Œæˆï¼");
}
```

---

## 3. ğŸ› ï¸ FilterConfigé…ç½®ç¥å™¨


### 3.1 FilterConfigæ˜¯ä»€ä¹ˆï¼Ÿ


FilterConfigå°±åƒè¿‡æ»¤å™¨çš„"ä¸ªäººæ¡£æ¡ˆè¢‹"ï¼Œé‡Œé¢è£…ç€è¿‡æ»¤å™¨éœ€è¦çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼š

```
FilterConfigæ¡£æ¡ˆè¢‹å†…å®¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ è¿‡æ»¤å™¨åç§°            â”‚
â”‚ âš™ï¸ åˆå§‹åŒ–å‚æ•°åˆ—è¡¨        â”‚
â”‚ ğŸŒ ServletContextä¸Šä¸‹æ–‡  â”‚
â”‚ ğŸ“‹ å…¶ä»–é…ç½®ä¿¡æ¯          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å¸¸ç”¨æ–¹æ³•è¯¦è§£


**ğŸ” è·å–è¿‡æ»¤å™¨åç§°**
```java
String filterName = filterConfig.getFilterName();
System.out.println("æˆ‘çš„åå­—æ˜¯ï¼š" + filterName);
```

**ğŸ“– è¯»å–åˆå§‹åŒ–å‚æ•°**
```java
// è·å–å•ä¸ªå‚æ•°
String encoding = filterConfig.getInitParameter("encoding");

// è·å–æ‰€æœ‰å‚æ•°å
Enumeration<String> paramNames = filterConfig.getInitParameterNames();
while (paramNames.hasMoreElements()) {
    String paramName = paramNames.nextElement();
    String paramValue = filterConfig.getInitParameter(paramName);
    System.out.println(paramName + " = " + paramValue);
}
```

**ğŸŒ è·å–ServletContext**
```java
ServletContext context = filterConfig.getServletContext();
String contextPath = context.getContextPath();
System.out.println("åº”ç”¨è·¯å¾„ï¼š" + contextPath);
```

### 3.3 é…ç½®æ–‡ä»¶ç¤ºä¾‹


**web.xmlé…ç½®ï¼š**
```xml
<filter>
    <filter-name>MyCharacterFilter</filter-name>
    <filter-class>com.example.MyCharacterFilter</filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
    <init-param>
        <param-name>logEnabled</param-name>
        <param-value>true</param-value>
    </init-param>
</filter>
```

---

## 4. ğŸ”— FilterChainè´£ä»»é“¾æ¨¡å¼


### 4.4 FilterChainå·¥ä½œåŸç†


FilterChainå°±åƒæ¥åŠ›èµ›çš„æ¥åŠ›æ£’ï¼Œç¡®ä¿è¯·æ±‚èƒ½å¤Ÿé¡ºåˆ©ä¼ é€’ï¼š

```
è¯·æ±‚ä¼ é€’ç¤ºæ„å›¾ï¼š

Filter1 âœ Filter2 âœ Filter3 âœ Servlet
   â†‘        â†‘        â†‘        â†“
   â¬…â”€â”€â”€â”€â”€â¬…â”€â”€â”€â”€â”€â¬…â”€â”€â”€â”€â”€â¬…â”€â”€â”€â”€â”€å“åº”
```

**ğŸ¯ æ ¸å¿ƒæ–¹æ³•ï¼š**
```java
// å°†è¯·æ±‚ä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªç»„ä»¶
void doFilter(ServletRequest request, ServletResponse response) 
    throws IOException, ServletException;
```

### 4.2 FilterChainçš„é­”æ³•åŸç†


**ğŸ”® å†…éƒ¨å·¥ä½œæœºåˆ¶ï¼š**

1. **ç»´æŠ¤è¿‡æ»¤å™¨åˆ—è¡¨**ï¼šChainå†…éƒ¨æœ‰ä¸€ä¸ªè¿‡æ»¤å™¨é˜Ÿåˆ—
2. **æŒ‡é’ˆæ§åˆ¶**ï¼šç”¨æŒ‡é’ˆè®°å½•å½“å‰æ‰§è¡Œä½ç½®
3. **é€’å½’è°ƒç”¨**ï¼šæ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨
4. **è‡ªåŠ¨è¿”å›**ï¼šåˆ°è¾¾ç»ˆç‚¹åè‡ªåŠ¨æŒ‰åŸè·¯è¿”å›

```
æ‰§è¡Œé¡ºåºæ¼”ç¤ºï¼š

æ—¶é—´çº¿ï¼š  Filter1    Filter2    Servlet    Filter2    Filter1
       â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”
è¯·æ±‚ âœ â”‚ å‰  â”‚ âœ â”‚ å‰  â”‚ âœ â”‚å¤„ç† â”‚ âœ â”‚ å  â”‚ âœ â”‚ å  â”‚ âœ å“åº”
       â”‚ å¤„  â”‚    â”‚ å¤„  â”‚    â”‚è¯·æ±‚ â”‚    â”‚ å¤„  â”‚    â”‚ å¤„  â”‚
       â”‚ ç†  â”‚    â”‚ ç†  â”‚    â”‚     â”‚    â”‚ ç†  â”‚    â”‚ ç†  â”‚
       â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜
```

### 4.3 FilterChainä½¿ç”¨æ³¨æ„äº‹é¡¹


**âœ… æ­£ç¡®ä½¿ç”¨ï¼š**
```java
public void doFilter(ServletRequest request, ServletResponse response, 
                     FilterChain chain) throws IOException, ServletException {
    // å‰ç½®å¤„ç†
    System.out.println("è¯·æ±‚è¿›å…¥è¿‡æ»¤å™¨");
    
    // ğŸ¯ å¿…é¡»è°ƒç”¨ï¼Œå¦åˆ™è¯·æ±‚è¢«å¡ä½ï¼
    chain.doFilter(request, response);
    
    // åç½®å¤„ç†
    System.out.println("è¯·æ±‚ç¦»å¼€è¿‡æ»¤å™¨");
}
```

**âŒ é”™è¯¯ç¤ºä¾‹ï¼š**
```java
public void doFilter(ServletRequest request, ServletResponse response, 
                     FilterChain chain) throws IOException, ServletException {
    // å‰ç½®å¤„ç†
    System.out.println("è¯·æ±‚è¿›å…¥è¿‡æ»¤å™¨");
    
    // ğŸ’¥ å¿˜è®°è°ƒç”¨chain.doFilter()ï¼Œè¯·æ±‚è¢«æ‹¦æˆªï¼
    // chain.doFilter(request, response);  // è¢«æ³¨é‡Šäº†
    
    response.getWriter().write("è¯·æ±‚è¢«æ‹¦æˆªï¼");
}
```

---

## 5. ğŸ¨ Requestå’ŒResponseåŒ…è£…æŠ€å·§


### 5.1 ä¸ºä»€ä¹ˆè¦åŒ…è£…ï¼Ÿ


æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ”¶åˆ°ä¸€ä»½å¿«é€’ï¼Œä½†æ˜¯åŒ…è£…ä¸å¤Ÿç²¾ç¾ï¼Œä½ æƒ³é‡æ–°åŒ…è£…ä¸€ä¸‹ï¼š

```
åŸå§‹å¿«é€’ç›’    åŒ…è£…å‡çº§å     æœ€ç»ˆæ•ˆæœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æ™®é€šçº¸ç›’ â”‚ âœ â”‚+ ç¼å¸¦   â”‚ âœ â”‚ ç²¾ç¾ç¤¼ç›’  â”‚
â”‚        â”‚   â”‚+ è´ºå¡   â”‚   â”‚ + é¢å¤–åŠŸèƒ½ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Request/ResponseåŒ…è£…çš„å¥½å¤„ï¼š**
- ğŸ **å¢å¼ºåŠŸèƒ½**ï¼šæ·»åŠ åŸæ¥æ²¡æœ‰çš„åŠŸèƒ½
- ğŸ”§ **ä¿®æ”¹è¡Œä¸º**ï¼šæ”¹å˜åŸæœ‰æ–¹æ³•çš„è¡Œä¸º
- ğŸ“Š **è®°å½•ä¿¡æ¯**ï¼šè®°å½•è¯·æ±‚å“åº”çš„è¯¦ç»†ä¿¡æ¯
- ğŸ›¡ï¸ **å®‰å…¨æ§åˆ¶**ï¼šæ·»åŠ å®‰å…¨æ£€æŸ¥é€»è¾‘

### 5.2 HttpServletRequestWrapperä½¿ç”¨


**ğŸ“¦ åŒ…è£…Requestç¤ºä¾‹ï¼š**

```java
public class LoggingRequestWrapper extends HttpServletRequestWrapper {
    
    public LoggingRequestWrapper(HttpServletRequest request) {
        super(request);  // è°ƒç”¨çˆ¶ç±»æ„é€ å™¨
    }
    
    // ğŸ” é‡å†™æ–¹æ³•ï¼Œæ·»åŠ æ—¥å¿—åŠŸèƒ½
    @Override
    public String getParameter(String name) {
        String value = super.getParameter(name);
        System.out.println("ğŸ“ è·å–å‚æ•°ï¼š" + name + " = " + value);
        return value;
    }
    
    // ğŸ“Š æ·»åŠ æ–°çš„åŠŸèƒ½
    public void logRequestInfo() {
        System.out.println("ğŸŒ è¯·æ±‚URLï¼š" + getRequestURL());
        System.out.println("ğŸ•’ è¯·æ±‚æ—¶é—´ï¼š" + new Date());
        System.out.println("ğŸ’» å®¢æˆ·ç«¯IPï¼š" + getRemoteAddr());
    }
}
```

**ğŸ¯ åœ¨Filterä¸­ä½¿ç”¨ï¼š**

```java
public void doFilter(ServletRequest request, ServletResponse response, 
                     FilterChain chain) throws IOException, ServletException {
    
    // ğŸ åŒ…è£…åŸå§‹è¯·æ±‚
    LoggingRequestWrapper wrappedRequest = 
        new LoggingRequestWrapper((HttpServletRequest) request);
    
    // ğŸ“Š è®°å½•è¯·æ±‚ä¿¡æ¯
    wrappedRequest.logRequestInfo();
    
    // ğŸš€ ä¼ é€’åŒ…è£…åçš„è¯·æ±‚
    chain.doFilter(wrappedRequest, response);
}
```

### 5.3 HttpServletResponseWrapperä½¿ç”¨


**ğŸ“¤ åŒ…è£…Responseç¤ºä¾‹ï¼š**

```java
public class CompressionResponseWrapper extends HttpServletResponseWrapper {
    private ByteArrayOutputStream buffer;
    private PrintWriter writer;
    
    public CompressionResponseWrapper(HttpServletResponse response) {
        super(response);
        buffer = new ByteArrayOutputStream();
    }
    
    // ğŸ”„ é‡å†™getWriteræ–¹æ³•
    @Override
    public PrintWriter getWriter() throws IOException {
        if (writer == null) {
            writer = new PrintWriter(new OutputStreamWriter(buffer, "UTF-8"));
        }
        return writer;
    }
    
    // ğŸ“Š è·å–ç¼“å­˜çš„å†…å®¹
    public byte[] getResponseData() throws IOException {
        if (writer != null) {
            writer.close();
        }
        return buffer.toByteArray();
    }
}
```

---

## 6. âš™ï¸ å‚æ•°è·å–ä¸ä¸Šä¸‹æ–‡è®¿é—®


### 6.1 åˆå§‹åŒ–å‚æ•°è·å–æŠ€å·§


**ğŸ“‹ å‚æ•°è·å–æœ€ä½³å®è·µï¼š**

```java
public class SmartFilter implements Filter {
    // ğŸ“ å£°æ˜é…ç½®å˜é‡
    private String encoding = "UTF-8";  // é»˜è®¤å€¼
    private boolean debugMode = false;
    private int maxSize = 1024;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // ğŸ” å®‰å…¨è·å–å‚æ•°ï¼ˆå¸¦é»˜è®¤å€¼ï¼‰
        String configEncoding = filterConfig.getInitParameter("encoding");
        if (configEncoding != null && !configEncoding.trim().isEmpty()) {
            this.encoding = configEncoding;
        }
        
        // ğŸ“Š å¸ƒå°”å‚æ•°å¤„ç†
        String debugFlag = filterConfig.getInitParameter("debug");
        this.debugMode = "true".equalsIgnoreCase(debugFlag);
        
        // ğŸ”¢ æ•°å­—å‚æ•°å¤„ç†ï¼ˆå¸¦å¼‚å¸¸å¤„ç†ï¼‰
        String sizeParam = filterConfig.getInitParameter("maxSize");
        if (sizeParam != null) {
            try {
                this.maxSize = Integer.parseInt(sizeParam);
            } catch (NumberFormatException e) {
                System.err.println("âš ï¸ maxSizeå‚æ•°æ ¼å¼é”™è¯¯ï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼š" + maxSize);
            }
        }
        
        // ğŸ“‹ è¾“å‡ºé…ç½®ä¿¡æ¯
        logConfig();
    }
    
    private void logConfig() {
        System.out.println("=== è¿‡æ»¤å™¨é…ç½®ä¿¡æ¯ ===");
        System.out.println("ğŸ”¤ ç¼–ç æ ¼å¼ï¼š" + encoding);
        System.out.println("ğŸ› è°ƒè¯•æ¨¡å¼ï¼š" + debugMode);
        System.out.println("ğŸ“ æœ€å¤§å¤§å°ï¼š" + maxSize);
        System.out.println("==================");
    }
}
```

### 6.2 ServletContextä¸Šä¸‹æ–‡è®¿é—®


**ğŸŒ ä¸Šä¸‹æ–‡è®¿é—®å®ç”¨æŠ€å·§ï¼š**

```java
@Override
public void init(FilterConfig filterConfig) throws ServletException {
    ServletContext context = filterConfig.getServletContext();
    
    // ğŸ“Š è·å–åº”ç”¨åŸºæœ¬ä¿¡æ¯
    String appName = context.getServletContextName();
    String contextPath = context.getContextPath();
    String serverInfo = context.getServerInfo();
    
    System.out.println("ğŸ·ï¸ åº”ç”¨åç§°ï¼š" + appName);
    System.out.println("ğŸ“ ä¸Šä¸‹æ–‡è·¯å¾„ï¼š" + contextPath);
    System.out.println("ğŸ–¥ï¸ æœåŠ¡å™¨ä¿¡æ¯ï¼š" + serverInfo);
    
    // ğŸ“‚ è·å–èµ„æºè·¯å¾„
    String configPath = context.getRealPath("/WEB-INF/config.properties");
    System.out.println("âš™ï¸ é…ç½®æ–‡ä»¶è·¯å¾„ï¼š" + configPath);
    
    // ğŸ”— è®¾ç½®åº”ç”¨çº§åˆ«çš„å±æ€§
    context.setAttribute("filterStartTime", System.currentTimeMillis());
    
    // ğŸ“– è¯»å–web.xmlä¸­çš„contextå‚æ•°
    String appVersion = context.getInitParameter("app.version");
    System.out.println("ğŸ“Œ åº”ç”¨ç‰ˆæœ¬ï¼š" + appVersion);
}
```

### 6.3 å‚æ•°éªŒè¯ä¸é”™è¯¯å¤„ç†


**ğŸ›¡ï¸ å¥å£®çš„å‚æ•°å¤„ç†ï¼š**

```java
public class RobustFilter implements Filter {
    
    private Map<String, String> validateConfig(FilterConfig config) {
        Map<String, String> validatedParams = new HashMap<>();
        
        // ğŸ“ å¿…éœ€å‚æ•°æ£€æŸ¥
        String[] requiredParams = {"encoding", "logLevel"};
        for (String param : requiredParams) {
            String value = config.getInitParameter(param);
            if (value == null || value.trim().isEmpty()) {
                throw new IllegalArgumentException("âŒ å¿…éœ€å‚æ•°ç¼ºå¤±ï¼š" + param);
            }
            validatedParams.put(param, value.trim());
        }
        
        // âœ… å¯é€‰å‚æ•°æ£€æŸ¥ï¼ˆå¸¦é»˜è®¤å€¼ï¼‰
        Map<String, String> optionalParams = new HashMap<>();
        optionalParams.put("maxConnections", "100");
        optionalParams.put("timeout", "30");
        
        for (Map.Entry<String, String> entry : optionalParams.entrySet()) {
            String key = entry.getKey();
            String defaultValue = entry.getValue();
            String value = config.getInitParameter(key);
            validatedParams.put(key, value != null ? value.trim() : defaultValue);
        }
        
        return validatedParams;
    }
}
```

---

## 7. ğŸš€ å®æˆ˜æ¼”ç»ƒä¸æ€»ç»“


### 7.1 ç»¼åˆå®æˆ˜ï¼šæ™ºèƒ½æ—¥å¿—è¿‡æ»¤å™¨


è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé›†æˆæ‰€æœ‰APIçŸ¥è¯†çš„æ™ºèƒ½è¿‡æ»¤å™¨ï¼š

```java
/**
 * ğŸ¯ æ™ºèƒ½æ—¥å¿—è¿‡æ»¤å™¨
 * åŠŸèƒ½ï¼šè¯·æ±‚æ—¥å¿—è®°å½• + æ€§èƒ½ç›‘æ§ + å‚æ•°è¿‡æ»¤
 */
public class SmartLoggingFilter implements Filter {
    
    // ğŸ“ é…ç½®å‚æ•°
    private boolean logEnabled;
    private String logLevel;
    private int slowRequestThreshold;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // ğŸ“– è¯»å–é…ç½®
        logEnabled = "true".equals(filterConfig.getInitParameter("logEnabled"));
        logLevel = filterConfig.getInitParameter("logLevel");
        
        String threshold = filterConfig.getInitParameter("slowRequestThreshold");
        slowRequestThreshold = threshold != null ? Integer.parseInt(threshold) : 1000;
        
        // ğŸ“Š è¾“å‡ºåˆå§‹åŒ–ä¿¡æ¯
        System.out.println("ğŸš€ SmartLoggingFilter å¯åŠ¨å®Œæˆï¼");
        System.out.println("ğŸ“‹ é…ç½®ä¿¡æ¯ - æ—¥å¿—å¼€å…³: " + logEnabled + 
                          ", çº§åˆ«: " + logLevel + 
                          ", æ…¢è¯·æ±‚é˜ˆå€¼: " + slowRequestThreshold + "ms");
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                         FilterChain chain) throws IOException, ServletException {
        
        if (!logEnabled) {
            chain.doFilter(request, response);
            return;
        }
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        
        // â±ï¸ è®°å½•å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        
        // ğŸ“ è®°å½•è¯·æ±‚ä¿¡æ¯
        String requestInfo = buildRequestInfo(httpRequest);
        System.out.println("ğŸ“¥ [REQUEST] " + requestInfo);
        
        try {
            // ğŸ¯ ä¼ é€’è¯·æ±‚
            chain.doFilter(request, response);
            
        } finally {
            // â±ï¸ è®¡ç®—æ‰§è¡Œæ—¶é—´
            long executionTime = System.currentTimeMillis() - startTime;
            
            // ğŸ“Š è¾“å‡ºæ€§èƒ½ä¿¡æ¯
            String performanceInfo = "âš¡ æ‰§è¡Œæ—¶é—´: " + executionTime + "ms";
            if (executionTime > slowRequestThreshold) {
                performanceInfo += " âš ï¸ æ…¢è¯·æ±‚è­¦å‘Šï¼";
            }
            
            System.out.println("ğŸ“¤ [RESPONSE] " + requestInfo + " - " + performanceInfo);
        }
    }
    
    // ğŸ”§ æ„å»ºè¯·æ±‚ä¿¡æ¯
    private String buildRequestInfo(HttpServletRequest request) {
        StringBuilder info = new StringBuilder();
        info.append(request.getMethod()).append(" ");
        info.append(request.getRequestURI());
        
        String queryString = request.getQueryString();
        if (queryString != null) {
            info.append("?").append(queryString);
        }
        
        info.append(" [").append(request.getRemoteAddr()).append("]");
        return info.toString();
    }
    
    @Override
    public void destroy() {
        System.out.println("ğŸ”š SmartLoggingFilter æ­£åœ¨å…³é—­...");
        System.out.println("âœ… è¿‡æ»¤å™¨é”€æ¯å®Œæˆï¼");
    }
}
```

### 7.2 æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“


**ğŸ“‹ Filter APIæŒæ¡æ¸…å•ï¼š**

- [x] **Filteræ¥å£ä¸‰å¤§æ–¹æ³•**ï¼š`init()`, `doFilter()`, `destroy()`
- [x] **FilterConfigé…ç½®è·å–**ï¼šå‚æ•°è¯»å–ã€ä¸Šä¸‹æ–‡è®¿é—®
- [x] **FilterChainé“¾å¼è°ƒç”¨**ï¼šè´£ä»»é“¾ä¼ é€’æœºåˆ¶
- [x] **Request/ResponseåŒ…è£…**ï¼šåŠŸèƒ½å¢å¼ºæŠ€å·§
- [x] **å‚æ•°å¤„ç†æœ€ä½³å®è·µ**ï¼šéªŒè¯ã€é»˜è®¤å€¼ã€é”™è¯¯å¤„ç†

**ğŸ¯ è®°å¿†å£è¯€ï¼š**

> ğŸ“ **Filter APIä¸‰ä»¶å®ï¼Œinité…ç½®doFilterè·‘**
> 
> ğŸ“‹ **Configè¯»å‚æ•°ï¼ŒChainä¼ é€’ä¸èƒ½å°‘**
> 
> ğŸ **Wrapperæ¥åŒ…è£…ï¼ŒåŠŸèƒ½å¢å¼ºæ•ˆæœå¥½**

**âš¡ å¼€å‘å®ç”¨æŠ€å·§ï¼š**

| ğŸ·ï¸ **åœºæ™¯** | ğŸ’¡ **æŠ€å·§** | ğŸ¯ **é‡ç‚¹** |
|--------------|-------------|-------------|
| **å‚æ•°é…ç½®** | æä¾›é»˜è®¤å€¼ï¼Œåšç©ºå€¼æ£€æŸ¥ | å¥å£®æ€§ä¼˜å…ˆ |
| **æ€§èƒ½ç›‘æ§** | è®°å½•æ—¶é—´ï¼Œè®¾ç½®é˜ˆå€¼ | ç”¨æˆ·ä½“éªŒ |
| **æ—¥å¿—è®°å½•** | ç»“æ„åŒ–è¾“å‡ºï¼Œåˆ†çº§ç®¡ç† | é—®é¢˜å®šä½ |
| **å¼‚å¸¸å¤„ç†** | try-finallyä¿è¯æ‰§è¡Œ | èµ„æºæ¸…ç† |

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šFilter APIè™½ç„¶ç®€å•ï¼Œä½†ç»„åˆä½¿ç”¨å¨åŠ›æ— ç©·ã€‚ä»ç®€å•çš„æ—¥å¿—è®°å½•å¼€å§‹ï¼Œé€æ­¥æ·»åŠ æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œè¿™æ ·å­¦ä¹ æ•ˆæœæœ€å¥½ï¼

**ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘ï¼š**
- è¿‡æ»¤å™¨é“¾çš„æ‰§è¡Œé¡ºåºæ§åˆ¶
- ä¸Springæ¡†æ¶çš„é›†æˆä½¿ç”¨  
- å¼‚æ­¥è¯·æ±‚çš„è¿‡æ»¤å™¨å¤„ç†
- å¾®æœåŠ¡ç¯å¢ƒä¸‹çš„è¿‡æ»¤å™¨è®¾è®¡