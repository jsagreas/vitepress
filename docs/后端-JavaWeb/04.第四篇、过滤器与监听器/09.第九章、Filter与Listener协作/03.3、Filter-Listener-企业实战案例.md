---
title: 3ã€Filter-Listener-ä¼ä¸šå®æˆ˜æ¡ˆä¾‹
---
## ğŸ“š ç›®å½•


1. [ç»Ÿä¸€è®¤è¯æˆæƒç³»ç»Ÿ](#1-ç»Ÿä¸€è®¤è¯æˆæƒç³»ç»Ÿ)
2. [å…¨é“¾è·¯æ—¥å¿—ç›‘æ§](#2-å…¨é“¾è·¯æ—¥å¿—ç›‘æ§)
3. [æ€§èƒ½ç›‘æ§å¹³å°](#3-æ€§èƒ½ç›‘æ§å¹³å°)
4. [å®‰å…¨é˜²æŠ¤ä½“ç³»](#4-å®‰å…¨é˜²æŠ¤ä½“ç³»)
5. [ç”¨æˆ·è¡Œä¸ºåˆ†æ](#5-ç”¨æˆ·è¡Œä¸ºåˆ†æ)
6. [ç³»ç»Ÿè¿ç»´ç›‘æ§](#6-ç³»ç»Ÿè¿ç»´ç›‘æ§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ ä¼ä¸šå®æˆ˜æ¡ˆä¾‹æ¦‚è¿°



åœ¨ä¼ä¸šçº§JavaWebå¼€å‘ä¸­ï¼ŒFilterå’ŒListenerå°±åƒæ˜¯ç³»ç»Ÿçš„"**å®‰ä¿äººå‘˜**"å’Œ"**ç®¡å®¶**"ã€‚Filterè´Ÿè´£åœ¨è¯·æ±‚è¿›å…¥ç³»ç»Ÿå‰è¿›è¡Œå„ç§æ£€æŸ¥å’Œå¤„ç†ï¼Œè€ŒListeneråˆ™è´Ÿè´£ç›‘å¬ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­çš„å„ç§äº‹ä»¶å¹¶åšå‡ºå“åº”ã€‚

> ğŸ’¡ **å½¢è±¡æ¯”å–»**ï¼šå¦‚æœæŠŠWebåº”ç”¨æ¯”ä½œä¸€æ ‹å¤§æ¥¼ï¼Œé‚£ä¹ˆFilterå°±æ˜¯é—¨å£çš„å®‰ä¿æ£€æŸ¥ï¼ŒListenerå°±æ˜¯æ¥¼å†…çš„ç›‘æ§ç³»ç»Ÿï¼Œä¸¤è€…é…åˆç¡®ä¿æ•´æ ‹æ¥¼çš„å®‰å…¨è¿è¡Œã€‚

---

## 1. ğŸ” ç»Ÿä¸€è®¤è¯æˆæƒç³»ç»Ÿ



### 1.1 ä¸šåŠ¡åœºæ™¯è¯´æ˜



**å®é™…éœ€æ±‚**ï¼šä¸€ä¸ªå¤§å‹ç”µå•†å¹³å°éœ€è¦å¯¹æ‰€æœ‰ç”¨æˆ·è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸åŒè§’è‰²çš„ç”¨æˆ·èƒ½è®¿é—®ä¸åŒçš„åŠŸèƒ½æ¨¡å—ã€‚

```
ç”¨æˆ·è®¿é—®æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ç™»å½•æ£€æŸ¥ â†’ æƒé™éªŒè¯ â†’ ä¸šåŠ¡å¤„ç† â†’ è®°å½•è®¿é—®æ—¥å¿—

è§’è‰²æƒé™åˆ†é…ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    è§’è‰²      â”‚   å¯è®¿é—®é¡µé¢   â”‚    æƒé™ç­‰çº§  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ¸¸å®¢       â”‚   é¦–é¡µã€å•†å“   â”‚     L1      â”‚
â”‚   ä¼šå‘˜       â”‚   ä¸ªäººä¸­å¿ƒ     â”‚     L2      â”‚
â”‚   VIPä¼šå‘˜    â”‚   VIPä¸“åŒº     â”‚     L3      â”‚
â”‚   ç®¡ç†å‘˜     â”‚   åå°ç®¡ç†     â”‚     L4      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒç»„ä»¶è®¾è®¡



**ğŸ”¸ ç”¨æˆ·ä¼šè¯ç›‘å¬å™¨**ï¼šç›‘å¬ç”¨æˆ·ç™»å½•å’Œç™»å‡º
```java
@WebListener
public class UserSessionListener implements HttpSessionListener {
    // åœ¨çº¿ç”¨æˆ·è®¡æ•°å™¨
    private static final AtomicInteger onlineUsers = new AtomicInteger(0);
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        // ç”¨æˆ·ä¸Šçº¿ï¼Œå¢åŠ è®¡æ•°
        int current = onlineUsers.incrementAndGet();
        System.out.println("ç”¨æˆ·ä¸Šçº¿ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + current);
        
        // è®°å½•åˆ°æ•°æ®åº“æˆ–ç¼“å­˜
        se.getSession().setAttribute("loginTime", new Date());
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        // ç”¨æˆ·ä¸‹çº¿ï¼Œå‡å°‘è®¡æ•°
        int current = onlineUsers.decrementAndGet();
        System.out.println("ç”¨æˆ·ä¸‹çº¿ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + current);
    }
    
    // è·å–åœ¨çº¿ç”¨æˆ·æ•°çš„æ–¹æ³•
    public static int getOnlineUserCount() {
        return onlineUsers.get();
    }
}
```

**ğŸ”¸ è®¤è¯è¿‡æ»¤å™¨**ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
```java
@WebFilter("/*")
public class AuthenticationFilter implements Filter {
    // ä¸éœ€è¦ç™»å½•å°±èƒ½è®¿é—®çš„é¡µé¢
    private Set<String> excludeUrls = new HashSet<>();
    
    @Override
    public void init(FilterConfig filterConfig) {
        // åˆå§‹åŒ–ä¸éœ€è¦éªŒè¯çš„URLåˆ—è¡¨
        excludeUrls.add("/login");
        excludeUrls.add("/register");
        excludeUrls.add("/index");
        excludeUrls.add("/api/public");
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        String uri = req.getRequestURI();
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦éªŒè¯
        if (isExcludeUrl(uri)) {
            chain.doFilter(request, response);
            return;
        }
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
        HttpSession session = req.getSession(false);
        if (session == null || session.getAttribute("user") == null) {
            // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
            resp.sendRedirect("/login?returnUrl=" + uri);
            return;
        }
        
        // å·²ç™»å½•ï¼Œç»§ç»­å¤„ç†
        chain.doFilter(request, response);
    }
    
    private boolean isExcludeUrl(String uri) {
        return excludeUrls.stream().anyMatch(uri::startsWith);
    }
}
```

**ğŸ”¸ æƒé™æ§åˆ¶è¿‡æ»¤å™¨**ï¼šéªŒè¯ç”¨æˆ·è®¿é—®æƒé™
```java
@WebFilter("/admin/*")
public class AuthorizationFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        HttpSession session = req.getSession();
        User user = (User) session.getAttribute("user");
        
        // æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦æœ‰æƒé™è®¿é—®ç®¡ç†é¡µé¢
        if (user == null || !"ADMIN".equals(user.getRole())) {
            // æ— æƒé™ï¼Œè¿”å›403é”™è¯¯
            resp.setStatus(HttpServletResponse.SC_FORBIDDEN);
            resp.getWriter().write("æ— æƒé™è®¿é—®æ­¤é¡µé¢");
            return;
        }
        
        // æœ‰æƒé™ï¼Œç»§ç»­å¤„ç†
        chain.doFilter(request, response);
    }
}
```

### 1.3 å®é™…è¿è¡Œæ•ˆæœ



**è®¤è¯æµç¨‹å›¾**ï¼š
```
ç”¨æˆ·è¯·æ±‚ (/admin/user/list)
    |
    â†“
è®¤è¯è¿‡æ»¤å™¨æ£€æŸ¥
    |
    â”œâ”€ æœªç™»å½• â†’ è·³è½¬ç™»å½•é¡µé¢
    |
    â””â”€ å·²ç™»å½• â†’ ç»§ç»­
            |
            â†“
        æƒé™è¿‡æ»¤å™¨æ£€æŸ¥
            |
            â”œâ”€ æ— æƒé™ â†’ è¿”å›403é”™è¯¯
            |
            â””â”€ æœ‰æƒé™ â†’ å¤„ç†ä¸šåŠ¡è¯·æ±‚
                    |
                    â†“
                Sessionç›‘å¬å™¨è®°å½•è®¿é—®
```

---

## 2. ğŸ“Š å…¨é“¾è·¯æ—¥å¿—ç›‘æ§



### 2.1 ç›‘æ§éœ€æ±‚åˆ†æ



**ä¸šåŠ¡åœºæ™¯**ï¼šç³»ç»Ÿéœ€è¦è®°å½•æ¯ä¸ªç”¨æˆ·çš„æ“ä½œè½¨è¿¹ï¼ŒåŒ…æ‹¬è®¿é—®äº†å“ªäº›é¡µé¢ã€æ“ä½œäº†ä»€ä¹ˆåŠŸèƒ½ã€èŠ±è´¹äº†å¤šé•¿æ—¶é—´ç­‰ï¼Œç”¨äºåç»­çš„æ•°æ®åˆ†æå’Œé—®é¢˜æ’æŸ¥ã€‚

> ğŸ¯ **ç›®æ ‡**ï¼šå®ç°è¯·æ±‚çš„å…¨ç”Ÿå‘½å‘¨æœŸè·Ÿè¸ªï¼Œå°±åƒç»™æ¯ä¸ªè¯·æ±‚éƒ½é…å¤‡ä¸€ä¸ª"è·Ÿè¸ªå™¨"ã€‚

### 2.2 æ—¥å¿—ç›‘æ§ç»„ä»¶



**ğŸ”¸ è¯·æ±‚è·Ÿè¸ªè¿‡æ»¤å™¨**ï¼šä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€æ ‡è¯†
```java
@WebFilter("/*")
public class RequestTrackingFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        
        // ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„è¿½è¸ªID
        String traceId = UUID.randomUUID().toString().substring(0, 8);
        
        // è®°å½•è¯·æ±‚å¼€å§‹ä¿¡æ¯
        long startTime = System.currentTimeMillis();
        String clientIP = getClientIP(req);
        String userAgent = req.getHeader("User-Agent");
        
        System.out.println("ğŸ” [" + traceId + "] è¯·æ±‚å¼€å§‹ï¼š" + 
                          req.getMethod() + " " + req.getRequestURI() + 
                          " æ¥æºIPï¼š" + clientIP);
        
        try {
            // å°†è¿½è¸ªIDå­˜å‚¨åˆ°è¯·æ±‚ä¸­ï¼Œåç»­å¯ä»¥ä½¿ç”¨
            req.setAttribute("traceId", traceId);
            req.setAttribute("startTime", startTime);
            
            // ç»§ç»­å¤„ç†è¯·æ±‚
            chain.doFilter(request, response);
            
        } finally {
            // è®°å½•è¯·æ±‚ç»“æŸä¿¡æ¯
            long endTime = System.currentTimeMillis();
            long duration = endTime - startTime;
            
            System.out.println("âœ… [" + traceId + "] è¯·æ±‚å®Œæˆï¼Œè€—æ—¶ï¼š" + duration + "ms");
            
            // å¦‚æœè¯·æ±‚è€—æ—¶è¿‡é•¿ï¼Œè®°å½•è­¦å‘Š
            if (duration > 3000) {
                System.out.println("âš ï¸  [" + traceId + "] æ…¢è¯·æ±‚è­¦å‘Šï¼è€—æ—¶ï¼š" + duration + "ms");
            }
        }
    }
    
    private String getClientIP(HttpServletRequest request) {
        // è·å–çœŸå®å®¢æˆ·ç«¯IPï¼ˆè€ƒè™‘ä»£ç†æƒ…å†µï¼‰
        String ip = request.getHeader("X-Forwarded-For");
        if (ip == null || ip.isEmpty()) {
            ip = request.getRemoteAddr();
        }
        return ip;
    }
}
```

**ğŸ”¸ åº”ç”¨ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨**ï¼šç›‘å¬åº”ç”¨å¯åŠ¨å’Œå…³é—­
```java
@WebListener
public class ApplicationLifecycleListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("ğŸš€ ç³»ç»Ÿå¯åŠ¨ - " + new Date());
        
        // åˆå§‹åŒ–ç³»ç»Ÿç»„ä»¶
        initializeSystem(sce.getServletContext());
        
        // è®°å½•ç³»ç»Ÿå¯åŠ¨ä¿¡æ¯
        logSystemInfo();
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("ğŸ›‘ ç³»ç»Ÿå…³é—­ - " + new Date());
        
        // æ¸…ç†èµ„æºï¼Œä¿å­˜é‡è¦æ•°æ®
        cleanupResources();
    }
    
    private void initializeSystem(ServletContext context) {
        // åˆå§‹åŒ–ç¼“å­˜ã€è¿æ¥æ± ç­‰
        System.out.println("ğŸ“¦ åˆå§‹åŒ–ç³»ç»Ÿç¼“å­˜...");
        System.out.println("ğŸ”— åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ...");
        System.out.println("âš™ï¸  åŠ è½½ç³»ç»Ÿé…ç½®...");
    }
    
    private void logSystemInfo() {
        // è®°å½•ç³»ç»Ÿè¿è¡Œç¯å¢ƒä¿¡æ¯
        System.out.println("ğŸ’» Javaç‰ˆæœ¬ï¼š" + System.getProperty("java.version"));
        System.out.println("ğŸ–¥ï¸  æ“ä½œç³»ç»Ÿï¼š" + System.getProperty("os.name"));
        System.out.println("ğŸ’¾ å¯ç”¨å†…å­˜ï¼š" + 
                          Runtime.getRuntime().maxMemory() / 1024 / 1024 + "MB");
    }
    
    private void cleanupResources() {
        System.out.println("ğŸ§¹ æ¸…ç†ä¸´æ—¶æ–‡ä»¶...");
        System.out.println("ğŸ’¾ ä¿å­˜ç¼“å­˜æ•°æ®...");
        System.out.println("ğŸ”Œ å…³é—­æ•°æ®åº“è¿æ¥...");
    }
}
```

### 2.3 æ—¥å¿—è¾“å‡ºç¤ºä¾‹



å½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿæ—¶ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºç±»ä¼¼è¿™æ ·çš„æ—¥å¿—ï¼š

```
ğŸš€ ç³»ç»Ÿå¯åŠ¨ - Wed Sep 24 14:30:00 CST 2025
ğŸ“¦ åˆå§‹åŒ–ç³»ç»Ÿç¼“å­˜...
ğŸ”— åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ...
âš™ï¸  åŠ è½½ç³»ç»Ÿé…ç½®...
ğŸ’» Javaç‰ˆæœ¬ï¼š17.0.1
ğŸ–¥ï¸  æ“ä½œç³»ç»Ÿï¼šWindows 11
ğŸ’¾ å¯ç”¨å†…å­˜ï¼š512MB

ğŸ” [a1b2c3d4] è¯·æ±‚å¼€å§‹ï¼šGET /admin/dashboard æ¥æºIPï¼š192.168.1.100
ç”¨æˆ·ä¸Šçº¿ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š5
âœ… [a1b2c3d4] è¯·æ±‚å®Œæˆï¼Œè€—æ—¶ï¼š245ms

ğŸ” [e5f6g7h8] è¯·æ±‚å¼€å§‹ï¼šPOST /api/user/update æ¥æºIPï¼š192.168.1.100
âš ï¸  [e5f6g7h8] æ…¢è¯·æ±‚è­¦å‘Šï¼è€—æ—¶ï¼š3500ms
âœ… [e5f6g7h8] è¯·æ±‚å®Œæˆï¼Œè€—æ—¶ï¼š3500ms
```

---

## 3. ğŸ“ˆ æ€§èƒ½ç›‘æ§å¹³å°



### 3.1 æ€§èƒ½ç›‘æ§éœ€æ±‚



**ç›‘æ§ç›®æ ‡**ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿæ€§èƒ½ï¼ŒåŒ…æ‹¬å“åº”æ—¶é—´ã€å¹¶å‘ç”¨æˆ·æ•°ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€æ•°æ®åº“è¿æ¥ç­‰å…³é”®æŒ‡æ ‡ã€‚

**ç›‘æ§ç»´åº¦**ï¼š
```
ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼š
â”œâ”€â”€ å“åº”æ—¶é—´ç›‘æ§
â”‚   â”œâ”€â”€ å¹³å‡å“åº”æ—¶é—´
â”‚   â”œâ”€â”€ æœ€é•¿å“åº”æ—¶é—´
â”‚   â””â”€â”€ å“åº”æ—¶é—´åˆ†å¸ƒ
â”œâ”€â”€ å¹¶å‘ç›‘æ§
â”‚   â”œâ”€â”€ å½“å‰åœ¨çº¿ç”¨æˆ·
â”‚   â”œâ”€â”€ åŒæ—¶å¤„ç†è¯·æ±‚æ•°
â”‚   â””â”€â”€ å³°å€¼å¹¶å‘è®°å½•
â””â”€â”€ èµ„æºç›‘æ§
    â”œâ”€â”€ å†…å­˜ä½¿ç”¨ç‡
    â”œâ”€â”€ CPUä½¿ç”¨ç‡
    â””â”€â”€ æ•°æ®åº“è¿æ¥æ•°
```

### 3.2 æ€§èƒ½ç›‘æ§ç»„ä»¶



**ğŸ”¸ æ€§èƒ½ç»Ÿè®¡è¿‡æ»¤å™¨**
```java
@WebFilter("/*")
public class PerformanceMonitorFilter implements Filter {
    // ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨
    private static final AtomicLong requestCount = new AtomicLong(0);
    private static final AtomicLong totalResponseTime = new AtomicLong(0);
    private static final AtomicLong maxResponseTime = new AtomicLong(0);
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        long startTime = System.currentTimeMillis();
        
        try {
            // å¤„ç†è¯·æ±‚
            chain.doFilter(request, response);
            
        } finally {
            // è®¡ç®—å“åº”æ—¶é—´
            long endTime = System.currentTimeMillis();
            long responseTime = endTime - startTime;
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStatistics(responseTime);
            
            // å®šæœŸè¾“å‡ºæ€§èƒ½æŠ¥å‘Š
            printPerformanceReport();
        }
    }
    
    private void updateStatistics(long responseTime) {
        requestCount.incrementAndGet();
        totalResponseTime.addAndGet(responseTime);
        
        // æ›´æ–°æœ€å¤§å“åº”æ—¶é—´
        maxResponseTime.updateAndGet(current -> Math.max(current, responseTime));
    }
    
    private void printPerformanceReport() {
        long count = requestCount.get();
        // æ¯100ä¸ªè¯·æ±‚è¾“å‡ºä¸€æ¬¡æŠ¥å‘Š
        if (count % 100 == 0) {
            long avgTime = totalResponseTime.get() / count;
            long maxTime = maxResponseTime.get();
            
            System.out.println("ğŸ“Š æ€§èƒ½æŠ¥å‘Š [è¯·æ±‚æ•°: " + count + "]");
            System.out.println("   â±ï¸  å¹³å‡å“åº”æ—¶é—´: " + avgTime + "ms");
            System.out.println("   ğŸš€ æœ€å¿«å“åº”æ—¶é—´: " + getMinResponseTime() + "ms");
            System.out.println("   ğŸŒ æœ€æ…¢å“åº”æ—¶é—´: " + maxTime + "ms");
            System.out.println("   ğŸ‘¥ å½“å‰åœ¨çº¿ç”¨æˆ·: " + UserSessionListener.getOnlineUserCount());
            System.out.println("   ğŸ’¾ å†…å­˜ä½¿ç”¨ç‡: " + getMemoryUsage() + "%");
        }
    }
    
    private String getMemoryUsage() {
        Runtime runtime = Runtime.getRuntime();
        long total = runtime.totalMemory();
        long free = runtime.freeMemory();
        long used = total - free;
        return String.format("%.1f", (used * 100.0) / total);
    }
    
    private long getMinResponseTime() {
        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…é¡¹ç›®ä¸­å¯ä»¥ç”¨æ›´å¤æ‚çš„ç»Ÿè®¡
        return Math.max(1, totalResponseTime.get() / requestCount.get() / 2);
    }
}
```

**ğŸ”¸ èµ„æºç›‘æ§ç›‘å¬å™¨**
```java
@WebListener
public class ResourceMonitorListener implements ServletRequestListener {
    private final ScheduledExecutorService scheduler = 
        Executors.newScheduledThreadPool(1);
    
    @Override
    public void requestInitialized(ServletRequestEvent sre) {
        // è¯·æ±‚å¼€å§‹æ—¶çš„å¤„ç†
        HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();
        request.setAttribute("requestStartTime", System.currentTimeMillis());
        
        // å¯åŠ¨èµ„æºç›‘æ§ï¼ˆä»…ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶å¯åŠ¨ï¼‰
        startResourceMonitoring();
    }
    
    private void startResourceMonitoring() {
        // æ¯30ç§’è¾“å‡ºä¸€æ¬¡ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
        scheduler.scheduleAtFixedRate(() -> {
            printResourceUsage();
        }, 0, 30, TimeUnit.SECONDS);
    }
    
    private void printResourceUsage() {
        Runtime runtime = Runtime.getRuntime();
        
        long maxMemory = runtime.maxMemory();
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        long usedMemory = totalMemory - freeMemory;
        
        System.out.println("ğŸ–¥ï¸  ç³»ç»Ÿèµ„æºç›‘æ§:");
        System.out.println("   ğŸ’¾ æœ€å¤§å†…å­˜: " + formatBytes(maxMemory));
        System.out.println("   ğŸ’¾ å·²åˆ†é…å†…å­˜: " + formatBytes(totalMemory));
        System.out.println("   ğŸ’¾ å·²ä½¿ç”¨å†…å­˜: " + formatBytes(usedMemory));
        System.out.println("   ğŸ’¾ å‰©ä½™å†…å­˜: " + formatBytes(freeMemory));
        System.out.println("   ğŸ“Š å†…å­˜ä½¿ç”¨ç‡: " + 
                          String.format("%.1f%%", (usedMemory * 100.0) / maxMemory));
    }
    
    private String formatBytes(long bytes) {
        return String.format("%.1f MB", bytes / 1024.0 / 1024.0);
    }
}
```

---

## 4. ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤ä½“ç³»



### 4.1 å®‰å…¨å¨èƒä¸é˜²æŠ¤



**å¸¸è§å®‰å…¨å¨èƒ**ï¼š
- **XSSæ”»å‡»**ï¼šæ¶æ„è„šæœ¬æ³¨å…¥
- **SQLæ³¨å…¥**ï¼šæ•°æ®åº“æ”»å‡»
- **CSRFæ”»å‡»**ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ 
- **æš´åŠ›ç ´è§£**ï¼šå¯†ç çŒœæµ‹æ”»å‡»

> âš ï¸ **å®‰å…¨æé†’**ï¼šå°±åƒç»™æˆ¿å­è£…é˜²ç›—é—¨çª—ä¸€æ ·ï¼ŒWebåº”ç”¨ä¹Ÿéœ€è¦å¤šå±‚å®‰å…¨é˜²æŠ¤ã€‚

### 4.2 å®‰å…¨é˜²æŠ¤ç»„ä»¶



**ğŸ”¸ XSSé˜²æŠ¤è¿‡æ»¤å™¨**
```java
@WebFilter("/*")
public class XSSProtectionFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // åŒ…è£…è¯·æ±‚ï¼Œè¿‡æ»¤æ¶æ„è„šæœ¬
        XSSRequestWrapper wrappedRequest = new XSSRequestWrapper(
            (HttpServletRequest) request);
        
        chain.doFilter(wrappedRequest, response);
    }
    
    // è¯·æ±‚åŒ…è£…å™¨ï¼Œè¿‡æ»¤å±é™©å­—ç¬¦
    private class XSSRequestWrapper extends HttpServletRequestWrapper {
        
        public XSSRequestWrapper(HttpServletRequest request) {
            super(request);
        }
        
        @Override
        public String getParameter(String name) {
            String value = super.getParameter(name);
            return cleanXSS(value);
        }
        
        @Override
        public String[] getParameterValues(String name) {
            String[] values = super.getParameterValues(name);
            if (values != null) {
                for (int i = 0; i < values.length; i++) {
                    values[i] = cleanXSS(values[i]);
                }
            }
            return values;
        }
        
        private String cleanXSS(String value) {
            if (value == null) return null;
            
            // ç§»é™¤å¸¸è§çš„XSSæ”»å‡»æ¨¡å¼
            value = value.replaceAll("<script", "&lt;script");
            value = value.replaceAll("</script>", "&lt;/script&gt;");
            value = value.replaceAll("javascript:", "");
            value = value.replaceAll("onload=", "");
            value = value.replaceAll("onerror=", "");
            
            return value;
        }
    }
}
```

**ğŸ”¸ è®¿é—®é¢‘ç‡é™åˆ¶è¿‡æ»¤å™¨**ï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰
```java
@WebFilter("/login")
public class RateLimitFilter implements Filter {
    // è®°å½•æ¯ä¸ªIPçš„è®¿é—®æ¬¡æ•°å’Œæ—¶é—´
    private final Map<String, RateLimitInfo> ipAccessMap = new ConcurrentHashMap<>();
    private final int MAX_REQUESTS = 5; // æœ€å¤§è¯·æ±‚æ¬¡æ•°
    private final long TIME_WINDOW = 60000; // æ—¶é—´çª—å£ï¼š1åˆ†é’Ÿ
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        String clientIP = req.getRemoteAddr();
        
        // æ£€æŸ¥è®¿é—®é¢‘ç‡
        if (isRateLimited(clientIP)) {
            resp.setStatus(429); // Too Many Requests
            resp.getWriter().write("è®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
            System.out.println("ğŸš¨ IP " + clientIP + " è§¦å‘è®¿é—®é¢‘ç‡é™åˆ¶");
            return;
        }
        
        chain.doFilter(request, response);
    }
    
    private boolean isRateLimited(String ip) {
        long currentTime = System.currentTimeMillis();
        
        RateLimitInfo info = ipAccessMap.computeIfAbsent(ip, 
            k -> new RateLimitInfo());
        
        // å¦‚æœè¶…è¿‡æ—¶é—´çª—å£ï¼Œé‡ç½®è®¡æ•°
        if (currentTime - info.firstRequestTime > TIME_WINDOW) {
            info.reset(currentTime);
        }
        
        info.requestCount++;
        
        // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
        return info.requestCount > MAX_REQUESTS;
    }
    
    private static class RateLimitInfo {
        long firstRequestTime;
        int requestCount;
        
        void reset(long time) {
            this.firstRequestTime = time;
            this.requestCount = 0;
        }
    }
}
```

### 4.3 å®‰å…¨ç›‘æ§ç›‘å¬å™¨



```java
@WebListener
public class SecurityMonitorListener implements HttpSessionListener {
    private static final Set<String> suspiciousIPs = new ConcurrentHashMap<String, Boolean>().keySet(ConcurrentHashMap.newKeySet());
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        
        // è®°å½•ä¼šè¯åˆ›å»ºä¿¡æ¯
        String sessionId = session.getId();
        System.out.println("ğŸ” æ–°ä¼šè¯åˆ›å»ºï¼š" + sessionId);
        
        // è®¾ç½®ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆ30åˆ†é’Ÿï¼‰
        session.setMaxInactiveInterval(30 * 60);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("ğŸ”“ ä¼šè¯ç»“æŸï¼š" + session.getId());
        
        // æ¸…ç†ç›¸å…³çš„å®‰å…¨ä¿¡æ¯
        cleanupSecurityInfo(session);
    }
    
    private void cleanupSecurityInfo(HttpSession session) {
        // æ¸…ç†ä¼šè¯ç›¸å…³çš„å®‰å…¨æ•°æ®
        System.out.println("ğŸ§¹ æ¸…ç†ä¼šè¯å®‰å…¨æ•°æ®");
    }
    
    // æ ‡è®°å¯ç–‘IP
    public static void markSuspiciousIP(String ip) {
        suspiciousIPs.add(ip);
        System.out.println("âš ï¸  æ ‡è®°å¯ç–‘IPï¼š" + ip);
    }
    
    // æ£€æŸ¥IPæ˜¯å¦å¯ç–‘
    public static boolean isSuspiciousIP(String ip) {
        return suspiciousIPs.contains(ip);
    }
}
```

---

## 5. ğŸ“Š ç”¨æˆ·è¡Œä¸ºåˆ†æ



### 5.1 è¡Œä¸ºåˆ†æéœ€æ±‚



**åˆ†æç›®æ ‡**ï¼šäº†è§£ç”¨æˆ·åœ¨ç½‘ç«™ä¸Šçš„è¡Œä¸ºæ¨¡å¼ï¼ŒåŒ…æ‹¬ï¼š
- ç”¨æˆ·æœ€å¸¸è®¿é—®çš„é¡µé¢
- ç”¨æˆ·åœç•™æ—¶é—´
- ç”¨æˆ·æ“ä½œè·¯å¾„
- ç”¨æˆ·è®¾å¤‡å’Œæµè§ˆå™¨ä¿¡æ¯

> ğŸ’¡ **å•†ä¸šä»·å€¼**ï¼šé€šè¿‡åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œå¯ä»¥ä¼˜åŒ–ç½‘ç«™è®¾è®¡ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œå¢åŠ è½¬åŒ–ç‡ã€‚

### 5.2 ç”¨æˆ·è¡Œä¸ºè¿½è¸ªç»„ä»¶



**ğŸ”¸ ç”¨æˆ·è¡Œä¸ºè®°å½•è¿‡æ»¤å™¨**
```java
@WebFilter("/*")
public class UserBehaviorFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpSession session = req.getSession();
        
        // è®°å½•ç”¨æˆ·è®¿é—®è¡Œä¸º
        recordUserBehavior(req, session);
        
        chain.doFilter(request, response);
    }
    
    private void recordUserBehavior(HttpServletRequest request, HttpSession session) {
        String userId = getUserId(session);
        String page = request.getRequestURI();
        String userAgent = request.getHeader("User-Agent");
        String referer = request.getHeader("Referer");
        
        // è§£æè®¾å¤‡å’Œæµè§ˆå™¨ä¿¡æ¯
        DeviceInfo deviceInfo = parseDeviceInfo(userAgent);
        
        // æ„å»ºè¡Œä¸ºè®°å½•
        UserBehavior behavior = new UserBehavior();
        behavior.setUserId(userId);
        behavior.setPage(page);
        behavior.setDeviceType(deviceInfo.getDeviceType());
        behavior.setBrowser(deviceInfo.getBrowser());
        behavior.setRefererPage(referer);
        behavior.setAccessTime(new Date());
        behavior.setSessionId(session.getId());
        
        // è®°å½•è¡Œä¸ºï¼ˆè¿™é‡Œç®€åŒ–ä¸ºæ‰“å°ï¼Œå®é™…é¡¹ç›®ä¸­ä¼šå­˜å‚¨åˆ°æ•°æ®åº“ï¼‰
        logUserBehavior(behavior);
        
        // æ›´æ–°ä¼šè¯ä¸­çš„è®¿é—®è·¯å¾„
        updateVisitPath(session, page);
    }
    
    private String getUserId(HttpSession session) {
        // è·å–ç”¨æˆ·IDï¼Œå¦‚æœæœªç™»å½•åˆ™ä½¿ç”¨ä¼šè¯ID
        Object userObj = session.getAttribute("user");
        if (userObj != null) {
            return ((User) userObj).getId().toString();
        }
        return "anonymous_" + session.getId();
    }
    
    private DeviceInfo parseDeviceInfo(String userAgent) {
        DeviceInfo info = new DeviceInfo();
        
        if (userAgent.contains("Mobile")) {
            info.setDeviceType("æ‰‹æœº");
        } else if (userAgent.contains("Tablet")) {
            info.setDeviceType("å¹³æ¿");
        } else {
            info.setDeviceType("ç”µè„‘");
        }
        
        if (userAgent.contains("Chrome")) {
            info.setBrowser("Chrome");
        } else if (userAgent.contains("Firefox")) {
            info.setBrowser("Firefox");
        } else if (userAgent.contains("Safari")) {
            info.setBrowser("Safari");
        } else {
            info.setBrowser("å…¶ä»–");
        }
        
        return info;
    }
    
    private void logUserBehavior(UserBehavior behavior) {
        System.out.println("ğŸ“± ç”¨æˆ·è¡Œä¸ºï¼š" + behavior.getUserId() + 
                          " è®¿é—®äº† " + behavior.getPage() + 
                          " [è®¾å¤‡ï¼š" + behavior.getDeviceType() + 
                          " æµè§ˆå™¨ï¼š" + behavior.getBrowser() + "]");
    }
    
    @SuppressWarnings("unchecked")
    private void updateVisitPath(HttpSession session, String page) {
        List<String> visitPath = (List<String>) session.getAttribute("visitPath");
        if (visitPath == null) {
            visitPath = new ArrayList<>();
            session.setAttribute("visitPath", visitPath);
        }
        visitPath.add(page + "@" + System.currentTimeMillis());
        
        // åªä¿ç•™æœ€è¿‘10ä¸ªè®¿é—®è®°å½•
        if (visitPath.size() > 10) {
            visitPath.remove(0);
        }
    }
    
    // ç”¨æˆ·è¡Œä¸ºæ•°æ®ç±»
    private static class UserBehavior {
        private String userId;
        private String page;
        private String deviceType;
        private String browser;
        private String refererPage;
        private Date accessTime;
        private String sessionId;
        
        // getterå’Œsetteræ–¹æ³•
        public String getUserId() { return userId; }
        public void setUserId(String userId) { this.userId = userId; }
        public String getPage() { return page; }
        public void setPage(String page) { this.page = page; }
        public String getDeviceType() { return deviceType; }
        public void setDeviceType(String deviceType) { this.deviceType = deviceType; }
        public String getBrowser() { return browser; }
        public void setBrowser(String browser) { this.browser = browser; }
        public String getRefererPage() { return refererPage; }
        public void setRefererPage(String refererPage) { this.refererPage = refererPage; }
        public Date getAccessTime() { return accessTime; }
        public void setAccessTime(Date accessTime) { this.accessTime = accessTime; }
        public String getSessionId() { return sessionId; }
        public void setSessionId(String sessionId) { this.sessionId = sessionId; }
    }
    
    // è®¾å¤‡ä¿¡æ¯ç±»
    private static class DeviceInfo {
        private String deviceType;
        private String browser;
        
        public String getDeviceType() { return deviceType; }
        public void setDeviceType(String deviceType) { this.deviceType = deviceType; }
        public String getBrowser() { return browser; }
        public void setBrowser(String browser) { this.browser = browser; }
    }
}
```

**ğŸ”¸ ç”¨æˆ·ä¼šè¯åˆ†æç›‘å¬å™¨**
```java
@WebListener
public class UserSessionAnalysisListener implements HttpSessionListener, HttpSessionAttributeListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("ğŸ†• æ–°ç”¨æˆ·ä¼šè¯å¼€å§‹ï¼š" + session.getId());
        
        // è®°å½•ä¼šè¯å¼€å§‹æ—¶é—´
        session.setAttribute("sessionStartTime", new Date());
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        
        // åˆ†æç”¨æˆ·ä¼šè¯æ•°æ®
        analyzeUserSession(session);
    }
    
    @Override
    public void attributeAdded(HttpSessionBindingEvent se) {
        String attributeName = se.getName();
        
        if ("user".equals(attributeName)) {
            // ç”¨æˆ·ç™»å½•äº†
            System.out.println("ğŸ‘¤ ç”¨æˆ·ç™»å½•ï¼šä¼šè¯ID " + se.getSession().getId());
            analyzeLoginBehavior(se.getSession());
        }
    }
    
    private void analyzeUserSession(HttpSession session) {
        Date startTime = (Date) session.getAttribute("sessionStartTime");
        Date endTime = new Date();
        
        if (startTime != null) {
            long sessionDuration = endTime.getTime() - startTime.getTime();
            long minutes = sessionDuration / 1000 / 60;
            
            System.out.println("ğŸ“Š ä¼šè¯åˆ†æï¼š");
            System.out.println("   â±ï¸  ä¼šè¯æ—¶é•¿ï¼š" + minutes + " åˆ†é’Ÿ");
            
            @SuppressWarnings("unchecked")
            List<String> visitPath = (List<String>) session.getAttribute("visitPath");
            if (visitPath != null) {
                System.out.println("   ğŸ—ºï¸  è®¿é—®è·¯å¾„ï¼š");
                for (String path : visitPath) {
                    String[] parts = path.split("@");
                    if (parts.length == 2) {
                        Date visitTime = new Date(Long.parseLong(parts[1]));
                        System.out.println("      " + parts[0] + " (" + 
                                          new SimpleDateFormat("HH:mm:ss").format(visitTime) + ")");
                    }
                }
                
                System.out.println("   ğŸ“ˆ è®¿é—®é¡µé¢æ•°ï¼š" + visitPath.size());
                analyzeUserInterest(visitPath);
            }
        }
    }
    
    private void analyzeLoginBehavior(HttpSession session) {
        Date sessionStart = (Date) session.getAttribute("sessionStartTime");
        Date loginTime = new Date();
        
        if (sessionStart != null) {
            long timeToLogin = loginTime.getTime() - sessionStart.getTime();
            long seconds = timeToLogin / 1000;
            
            System.out.println("ğŸ”‘ ç™»å½•è¡Œä¸ºåˆ†æï¼š");
            System.out.println("   â±ï¸  ä»è®¿é—®åˆ°ç™»å½•è€—æ—¶ï¼š" + seconds + " ç§’");
            
            if (seconds < 30) {
                System.out.println("   ğŸ¯ å¿«é€Ÿç™»å½•ç”¨æˆ·ï¼ˆè€ç”¨æˆ·ï¼‰");
            } else if (seconds > 300) {
                System.out.println("   ğŸ¤” çŠ¹è±«ç™»å½•ç”¨æˆ·ï¼ˆå¯èƒ½éœ€è¦å¼•å¯¼ï¼‰");
            }
        }
    }
    
    private void analyzeUserInterest(List<String> visitPath) {
        Map<String, Integer> pageCount = new HashMap<>();
        
        for (String path : visitPath) {
            String page = path.split("@")[0];
            pageCount.put(page, pageCount.getOrDefault(page, 0) + 1);
        }
        
        // æ‰¾å‡ºç”¨æˆ·æœ€æ„Ÿå…´è¶£çš„é¡µé¢
        String mostVisitedPage = pageCount.entrySet().stream()
            .max(Map.Entry.comparingByValue())
            .map(Map.Entry::getKey)
            .orElse("æ— ");
            
        System.out.println("   â¤ï¸  æœ€æ„Ÿå…´è¶£çš„é¡µé¢ï¼š" + mostVisitedPage);
    }
}
```

---

## 6. ğŸ”§ ç³»ç»Ÿè¿ç»´ç›‘æ§



### 6.1 è¿ç»´ç›‘æ§éœ€æ±‚



**ç›‘æ§èŒƒå›´**ï¼š
```
ç³»ç»Ÿå¥åº·çŠ¶å†µï¼š
â”œâ”€â”€ åº”ç”¨çŠ¶æ€ç›‘æ§
â”‚   â”œâ”€â”€ æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
â”‚   â”œâ”€â”€ å…³é”®åŠŸèƒ½æ˜¯å¦å¯ç”¨
â”‚   â””â”€â”€ ç³»ç»Ÿé”™è¯¯ç‡ç»Ÿè®¡
â”œâ”€â”€ èµ„æºä½¿ç”¨ç›‘æ§
â”‚   â”œâ”€â”€ CPUä½¿ç”¨ç‡
â”‚   â”œâ”€â”€ å†…å­˜ä½¿ç”¨ç‡
â”‚   â””â”€â”€ ç£ç›˜ç©ºé—´
â””â”€â”€ ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
    â”œâ”€â”€ ç”¨æˆ·æ´»è·ƒåº¦
    â”œâ”€â”€ äº¤æ˜“æˆåŠŸç‡
    â””â”€â”€ ç³»ç»Ÿå“åº”æ—¶é—´
```

### 6.2 è¿ç»´ç›‘æ§ç»„ä»¶



**ğŸ”¸ ç³»ç»Ÿå¥åº·æ£€æŸ¥ç›‘å¬å™¨**
```java
@WebListener
public class SystemHealthMonitorListener implements ServletContextListener {
    private ScheduledExecutorService healthCheckExecutor;
    private ScheduledExecutorService alertExecutor;
    
    // ç³»ç»Ÿå¥åº·çŠ¶æ€
    private final AtomicBoolean systemHealthy = new AtomicBoolean(true);
    private final Map<String, HealthStatus> componentStatus = new ConcurrentHashMap<>();
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("ğŸ¥ å¯åŠ¨ç³»ç»Ÿå¥åº·ç›‘æ§...");
        
        // åˆå§‹åŒ–ç»„ä»¶çŠ¶æ€
        initializeComponentStatus();
        
        // å¯åŠ¨å¥åº·æ£€æŸ¥ä»»åŠ¡
        startHealthCheck();
        
        // å¯åŠ¨å‘Šè­¦æœåŠ¡
        startAlertService();
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("ğŸ›‘ åœæ­¢ç³»ç»Ÿå¥åº·ç›‘æ§");
        
        if (healthCheckExecutor != null) {
            healthCheckExecutor.shutdown();
        }
        if (alertExecutor != null) {
            alertExecutor.shutdown();
        }
    }
    
    private void initializeComponentStatus() {
        // åˆå§‹åŒ–å„ä¸ªç»„ä»¶çš„å¥åº·çŠ¶æ€
        componentStatus.put("æ•°æ®åº“", new HealthStatus("æ•°æ®åº“", true, "è¿æ¥æ­£å¸¸"));
        componentStatus.put("ç¼“å­˜", new HealthStatus("ç¼“å­˜", true, "Redisè¿æ¥æ­£å¸¸"));
        componentStatus.put("æ–‡ä»¶ç³»ç»Ÿ", new HealthStatus("æ–‡ä»¶ç³»ç»Ÿ", true, "ç£ç›˜ç©ºé—´å……è¶³"));
        componentStatus.put("å¤–éƒ¨API", new HealthStatus("å¤–éƒ¨API", true, "ç¬¬ä¸‰æ–¹æœåŠ¡æ­£å¸¸"));
    }
    
    private void startHealthCheck() {
        healthCheckExecutor = Executors.newScheduledThreadPool(1);
        
        // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡å¥åº·æ£€æŸ¥
        healthCheckExecutor.scheduleAtFixedRate(() -> {
            performHealthCheck();
        }, 0, 60, TimeUnit.SECONDS);
    }
    
    private void startAlertService() {
        alertExecutor = Executors.newScheduledThreadPool(1);
        
        // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦å‘é€å‘Šè­¦
        alertExecutor.scheduleAtFixedRate(() -> {
            checkAndSendAlerts();
        }, 0, 5, TimeUnit.MINUTES);
    }
    
    private void performHealthCheck() {
        System.out.println("ğŸ” æ‰§è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥...");
        boolean allHealthy = true;
        
        // æ£€æŸ¥æ•°æ®åº“è¿æ¥
        allHealthy &= checkDatabase();
        
        // æ£€æŸ¥ç¼“å­˜æœåŠ¡
        allHealthy &= checkCache();
        
        // æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ
        allHealthy &= checkFileSystem();
        
        // æ£€æŸ¥å¤–éƒ¨API
        allHealthy &= checkExternalAPI();
        
        // æ›´æ–°ç³»ç»Ÿæ•´ä½“å¥åº·çŠ¶æ€
        systemHealthy.set(allHealthy);
        
        // è¾“å‡ºå¥åº·æ£€æŸ¥ç»“æœ
        printHealthStatus();
    }
    
    private boolean checkDatabase() {
        try {
            // æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥æ£€æŸ¥
            // å®é™…é¡¹ç›®ä¸­ä¼šæ‰§è¡Œç®€å•çš„SQLæŸ¥è¯¢
            if (Math.random() > 0.05) { // 95%æ¦‚ç‡æ­£å¸¸
                updateComponentStatus("æ•°æ®åº“", true, "è¿æ¥æ­£å¸¸");
                return true;
            } else {
                updateComponentStatus("æ•°æ®åº“", false, "è¿æ¥è¶…æ—¶");
                return false;
            }
        } catch (Exception e) {
            updateComponentStatus("æ•°æ®åº“", false, "æ£€æŸ¥å¼‚å¸¸: " + e.getMessage());
            return false;
        }
    }
    
    private boolean checkCache() {
        try {
            // æ¨¡æ‹Ÿç¼“å­˜è¿æ¥æ£€æŸ¥
            if (Math.random() > 0.03) { // 97%æ¦‚ç‡æ­£å¸¸
                updateComponentStatus("ç¼“å­˜", true, "Redisè¿æ¥æ­£å¸¸");
                return true;
            } else {
                updateComponentStatus("ç¼“å­˜", false, "Redisè¿æ¥å¤±è´¥");
                return false;
            }
        } catch (Exception e) {
            updateComponentStatus("ç¼“å­˜", false, "æ£€æŸ¥å¼‚å¸¸: " + e.getMessage());
            return false;
        }
    }
    
    private boolean checkFileSystem() {
        try {
            // æ£€æŸ¥ç£ç›˜ç©ºé—´
            File root = new File("/");
            long totalSpace = root.getTotalSpace();
            long freeSpace = root.getFreeSpace();
            double usagePercent = (double)(totalSpace - freeSpace) / totalSpace * 100;
            
            if (usagePercent < 90) {
                updateComponentStatus("æ–‡ä»¶ç³»ç»Ÿ", true, 
                    String.format("ç£ç›˜ä½¿ç”¨ç‡: %.1f%%", usagePercent));
                return true;
            } else {
                updateComponentStatus("æ–‡ä»¶ç³»ç»Ÿ", false, 
                    String.format("ç£ç›˜ç©ºé—´ä¸è¶³: %.1f%%", usagePercent));
                return false;
            }
        } catch (Exception e) {
            updateComponentStatus("æ–‡ä»¶ç³»ç»Ÿ", false, "æ£€æŸ¥å¼‚å¸¸: " + e.getMessage());
            return false;
        }
    }
    
    private boolean checkExternalAPI() {
        try {
            // æ¨¡æ‹Ÿå¤–éƒ¨APIæ£€æŸ¥
            if (Math.random() > 0.1) { // 90%æ¦‚ç‡æ­£å¸¸
                updateComponentStatus("å¤–éƒ¨API", true, "ç¬¬ä¸‰æ–¹æœåŠ¡å“åº”æ­£å¸¸");
                return true;
            } else {
                updateComponentStatus("å¤–éƒ¨API", false, "ç¬¬ä¸‰æ–¹æœåŠ¡å“åº”è¶…æ—¶");
                return false;
            }
        } catch (Exception e) {
            updateComponentStatus("å¤–éƒ¨API", false, "æ£€æŸ¥å¼‚å¸¸: " + e.getMessage());
            return false;
        }
    }
    
    private void updateComponentStatus(String component, boolean healthy, String message) {
        HealthStatus status = componentStatus.get(component);
        if (status != null) {
            status.setHealthy(healthy);
            status.setMessage(message);
            status.setLastCheckTime(new Date());
        }
    }
    
    private void printHealthStatus() {
        System.out.println("ğŸ¥ ç³»ç»Ÿå¥åº·çŠ¶æ€æŠ¥å‘Šï¼š");
        System.out.println("   æ•´ä½“çŠ¶æ€ï¼š" + (systemHealthy.get() ? "ğŸŸ¢ å¥åº·" : "ğŸ”´ å¼‚å¸¸"));
        
        componentStatus.values().forEach(status -> {
            String icon = status.isHealthy() ? "âœ…" : "âŒ";
            System.out.println("   " + icon + " " + status.getComponent() + 
                             ": " + status.getMessage());
        });
    }
    
    private void checkAndSendAlerts() {
        if (!systemHealthy.get()) {
            System.out.println("ğŸš¨ ç³»ç»Ÿå‘Šè­¦ï¼šæ£€æµ‹åˆ°ç³»ç»Ÿå¼‚å¸¸ï¼");
            
            // æ‰¾å‡ºå¼‚å¸¸çš„ç»„ä»¶
            componentStatus.values().stream()
                .filter(status -> !status.isHealthy())
                .forEach(status -> {
                    System.out.println("   ğŸ”´ " + status.getComponent() + 
                                     " å¼‚å¸¸: " + status.getMessage());
                });
            
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šå‘é€é‚®ä»¶ã€çŸ­ä¿¡æˆ–æ¨é€æ¶ˆæ¯ç»™è¿ç»´äººå‘˜
            sendAlert("ç³»ç»Ÿç»„ä»¶å¼‚å¸¸ï¼Œè¯·ç«‹å³æ£€æŸ¥");
        }
    }
    
    private void sendAlert(String message) {
        // æ¨¡æ‹Ÿå‘é€å‘Šè­¦é€šçŸ¥
        System.out.println("ğŸ“§ å‘é€å‘Šè­¦é€šçŸ¥: " + message);
        System.out.println("ğŸ“± å‘é€çŸ­ä¿¡å‘Šè­¦åˆ°è¿ç»´äººå‘˜æ‰‹æœº");
    }
    
    // å¥åº·çŠ¶æ€æ•°æ®ç±»
    private static class HealthStatus {
        private String component;
        private boolean healthy;
        private String message;
        private Date lastCheckTime;
        
        public HealthStatus(String component, boolean healthy, String message) {
            this.component = component;
            this.healthy = healthy;
            this.message = message;
            this.lastCheckTime = new Date();
        }
        
        // getterå’Œsetteræ–¹æ³•
        public String getComponent() { return component; }
        public boolean isHealthy() { return healthy; }
        public void setHealthy(boolean healthy) { this.healthy = healthy; }
        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }
        public Date getLastCheckTime() { return lastCheckTime; }
        public void setLastCheckTime(Date lastCheckTime) { this.lastCheckTime = lastCheckTime; }
    }
}
```

### 6.3 ç»¼åˆç›‘æ§å±•ç¤º



å½“ç³»ç»Ÿè¿è¡Œæ—¶ï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤ºç±»ä¼¼è¿™æ ·çš„ç›‘æ§ä¿¡æ¯ï¼š

```
ğŸš€ ç³»ç»Ÿå¯åŠ¨ - Wed Sep 24 14:30:00 CST 2025
ğŸ¥ å¯åŠ¨ç³»ç»Ÿå¥åº·ç›‘æ§...

ğŸ” æ‰§è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥...
ğŸ¥ ç³»ç»Ÿå¥åº·çŠ¶æ€æŠ¥å‘Šï¼š
   æ•´ä½“çŠ¶æ€ï¼šğŸŸ¢ å¥åº·
   âœ… æ•°æ®åº“: è¿æ¥æ­£å¸¸
   âœ… ç¼“å­˜: Redisè¿æ¥æ­£å¸¸
   âœ… æ–‡ä»¶ç³»ç»Ÿ: ç£ç›˜ä½¿ç”¨ç‡: 45.2%
   âœ… å¤–éƒ¨API: ç¬¬ä¸‰æ–¹æœåŠ¡å“åº”æ­£å¸¸

ğŸ“Š æ€§èƒ½æŠ¥å‘Š [è¯·æ±‚æ•°: 100]
   â±ï¸  å¹³å‡å“åº”æ—¶é—´: 234ms
   ğŸš€ æœ€å¿«å“åº”æ—¶é—´: 45ms
   ğŸŒ æœ€æ…¢å“åº”æ—¶é—´: 1234ms
   ğŸ‘¥ å½“å‰åœ¨çº¿ç”¨æˆ·: 8
   ğŸ’¾ å†…å­˜ä½¿ç”¨ç‡: 67.3%

ğŸ“± ç”¨æˆ·è¡Œä¸ºï¼šanonymous_A1B2C3D4 è®¿é—®äº† /index [è®¾å¤‡ï¼šç”µè„‘ æµè§ˆå™¨ï¼šChrome]
ğŸ“± ç”¨æˆ·è¡Œä¸ºï¼šuser123 è®¿é—®äº† /profile [è®¾å¤‡ï¼šæ‰‹æœº æµè§ˆå™¨ï¼šSafari]

ğŸ–¥ï¸  ç³»ç»Ÿèµ„æºç›‘æ§:
   ğŸ’¾ æœ€å¤§å†…å­˜: 512.0 MB
   ğŸ’¾ å·²åˆ†é…å†…å­˜: 256.0 MB
   ğŸ’¾ å·²ä½¿ç”¨å†…å­˜: 172.5 MB
   ğŸ’¾ å‰©ä½™å†…å­˜: 83.5 MB
   ğŸ“Š å†…å­˜ä½¿ç”¨ç‡: 33.7%
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 7.1 ä¼ä¸šçº§åº”ç”¨çš„å…³é”®ç‰¹ç‚¹



**ğŸ¯ ç³»ç»Ÿç‰¹å¾**ï¼š
```
é«˜å¯ç”¨æ€§ï¼š
â€¢ å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨
â€¢ å®æ—¶ç›‘æ§å‘Šè­¦ï¼Œå¿«é€Ÿå“åº”é—®é¢˜
â€¢ æ€§èƒ½ç›‘æ§ä¼˜åŒ–ï¼Œä¿è¯ç”¨æˆ·ä½“éªŒ

å¯è§‚æµ‹æ€§ï¼š
â€¢ å…¨é“¾è·¯æ—¥å¿—è·Ÿè¸ªï¼Œé—®é¢˜å¯è¿½æº¯
â€¢ ç”¨æˆ·è¡Œä¸ºåˆ†æï¼Œä¸šåŠ¡å¯æ´å¯Ÿ
â€¢ ç³»ç»Ÿå¥åº·ç›‘æ§ï¼ŒçŠ¶æ€å¯æŒæ§

å¯ç»´æŠ¤æ€§ï¼š
â€¢ ç»„ä»¶è§£è€¦è®¾è®¡ï¼Œä¾¿äºä¿®æ”¹æ‰©å±•
â€¢ ç»Ÿä¸€æ ‡å‡†è§„èŒƒï¼Œé™ä½ç»´æŠ¤æˆæœ¬
â€¢ è‡ªåŠ¨åŒ–ç›‘æ§ï¼Œå‡å°‘äººå·¥å¹²é¢„
```

### 7.2 Filterä¸Listeneråä½œæ¨¡å¼



**åä½œå…³ç³»å›¾**ï¼š
```
ç”¨æˆ·è¯·æ±‚
    |
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Filteré“¾æ¡å¤„ç†                â”‚
â”‚                                         â”‚
â”‚ è®¤è¯è¿‡æ»¤å™¨ â†’ æƒé™è¿‡æ»¤å™¨ â†’ æ—¥å¿—è¿‡æ»¤å™¨     â”‚
â”‚     â†“           â†“           â†“          â”‚
â”‚   ç™»å½•æ£€æŸ¥    æƒé™éªŒè¯    è®°å½•è®¿é—®       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    |
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸šåŠ¡å¤„ç† & äº‹ä»¶ç›‘å¬             â”‚
â”‚                                         â”‚
â”‚ ä¸šåŠ¡é€»è¾‘å¤„ç†                            â”‚
â”‚     â†“                                   â”‚
â”‚ Listenerç›‘å¬äº‹ä»¶                        â”‚
â”‚ â€¢ ä¼šè¯åˆ›å»º/é”€æ¯                         â”‚
â”‚ â€¢ å±æ€§å˜æ›´                             â”‚
â”‚ â€¢ åº”ç”¨å¯åŠ¨/å…³é—­                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    |
    â†“
å“åº”è¿”å›ç»™ç”¨æˆ·
```

### 7.3 å®æ–½è¦ç‚¹å’Œæœ€ä½³å®è·µ



**ğŸ”§ å®æ–½å»ºè®®**ï¼š

â‘  **åˆ†å±‚è®¾è®¡åŸåˆ™**
- **Filterå±‚**ï¼šè´Ÿè´£è¯·æ±‚é¢„å¤„ç†ï¼ˆè®¤è¯ã€æˆæƒã€æ—¥å¿—ã€å®‰å…¨ï¼‰
- **Listenerå±‚**ï¼šè´Ÿè´£äº‹ä»¶ç›‘å¬ï¼ˆçŠ¶æ€å˜åŒ–ã€ç”Ÿå‘½å‘¨æœŸã€è¡Œä¸ºåˆ†æï¼‰
- **ä¸šåŠ¡å±‚**ï¼šä¸“æ³¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

â‘¡ **æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
- é¿å…åœ¨Filterä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- åˆç†è®¾ç½®ç›‘å¬å™¨çš„æ‰§è¡Œé¢‘ç‡
- ä½¿ç”¨å¼‚æ­¥å¤„ç†å‡å°‘å“åº”æ—¶é—´

â‘¢ **å®‰å…¨é˜²æŠ¤ç­–ç•¥**
- å¤šå±‚é˜²æŠ¤ï¼šè®¤è¯â†’æˆæƒâ†’æ•°æ®è¿‡æ»¤â†’è¡Œä¸ºç›‘æ§
- å®æ—¶æ£€æµ‹ï¼šè®¿é—®é¢‘ç‡ã€å¼‚å¸¸è¡Œä¸ºã€å®‰å…¨å¨èƒ
- åŠæ—¶å“åº”ï¼šè‡ªåŠ¨é˜»æ–­ã€å‘Šè­¦é€šçŸ¥ã€æ—¥å¿—è®°å½•

â‘£ **ç›‘æ§è¿ç»´è§„èŒƒ**
- **å…¨é¢ç›‘æ§**ï¼šæ€§èƒ½ã€å®‰å…¨ã€ä¸šåŠ¡ã€ç³»ç»Ÿå¥åº·
- **æ™ºèƒ½å‘Šè­¦**ï¼šé˜ˆå€¼è®¾å®šã€åˆ†çº§å¤„ç†ã€è‡ªåŠ¨æ¢å¤
- **æ•°æ®é©±åŠ¨**ï¼šåŸºäºç›‘æ§æ•°æ®åšå†³ç­–å’Œä¼˜åŒ–

> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**ï¼šFilterå’ŒListenerå°±åƒä¼ä¸šç³»ç»Ÿçš„"**ç¥ç»ç½‘ç»œ**"ï¼ŒFilteræ˜¯"**æ„Ÿè§‰ç¥ç»**"è´Ÿè´£æ„ŸçŸ¥å¤–ç•Œè¾“å…¥ï¼ŒListeneræ˜¯"**åå°„ç¥ç»**"è´Ÿè´£å“åº”å†…éƒ¨å˜åŒ–ï¼Œä¸¤è€…ååŒå·¥ä½œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šã€å®‰å…¨ã€é«˜æ•ˆè¿è¡Œã€‚

**è®°å¿†è¦ç‚¹**ï¼š
- **Filter**ï¼šé—¨å«+ä¿å®‰ï¼ŒæŠŠå®ˆç³»ç»Ÿå…¥å£
- **Listener**ï¼šç®¡å®¶+ç›‘å·¥ï¼Œå…³æ³¨ç³»ç»ŸåŠ¨æ€  
- **åä½œ**ï¼šå¤–é˜²å†…æ§ï¼Œç¡®ä¿ç³»ç»Ÿå¥åº·è¿è¡Œ
- **ä¼ä¸šçº§**ï¼šé«˜å¯ç”¨ã€å¯è§‚æµ‹ã€å¯ç»´æŠ¤