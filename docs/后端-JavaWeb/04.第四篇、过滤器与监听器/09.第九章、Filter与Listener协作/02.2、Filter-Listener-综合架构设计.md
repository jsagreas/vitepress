---
title: 2ã€Filter-Listener-ç»¼åˆæ¶æ„è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Filterä¸Listeneråä½œæ¶æ„](#1-ä»€ä¹ˆæ˜¯filterä¸listeneråä½œæ¶æ„)
2. [åˆ†å±‚æ¶æ„è®¾è®¡](#2-åˆ†å±‚æ¶æ„è®¾è®¡)
3. [èŒè´£è¾¹ç•Œåˆ’åˆ†](#3-èŒè´£è¾¹ç•Œåˆ’åˆ†)
4. [æ¨¡å—åŒ–ç»„ç»‡](#4-æ¨¡å—åŒ–ç»„ç»‡)
5. [å¯æ‰©å±•æ€§è®¾è®¡](#5-å¯æ‰©å±•æ€§è®¾è®¡)
6. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#6-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
7. [å¯ç»´æŠ¤æ€§ä¿è¯](#7-å¯ç»´æŠ¤æ€§ä¿è¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ ä»€ä¹ˆæ˜¯Filterä¸Listeneråä½œæ¶æ„


### 1.1 æ¶æ„æ¦‚å¿µè§£é‡Š


**ä»€ä¹ˆæ˜¯åä½œæ¶æ„ï¼Ÿ**

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒä¸€ä¸ªé¤å…çš„è¿è¥ä½“ç³»ï¼ŒFilteråƒé—¨å£çš„æœåŠ¡å‘˜è´Ÿè´£å¼•å¯¼å’Œæ£€æŸ¥ï¼ŒListeneråƒåå¨çš„ç®¡ç†å‘˜è´Ÿè´£ç›‘æ§å’Œç»Ÿè®¡ï¼Œä¸¤è€…é…åˆè®©æ•´ä¸ªé¤å…è¿è½¬é¡ºç•…ã€‚

åœ¨JavaWebä¸­ï¼ŒFilterä¸Listeneråä½œæ¶æ„æ˜¯æŒ‡ï¼š
- **Filter**ï¼šè´Ÿè´£è¯·æ±‚çš„**é¢„å¤„ç†å’Œåå¤„ç†**
- **Listener**ï¼šè´Ÿè´£**ç›‘æ§å’Œç®¡ç†**åº”ç”¨çŠ¶æ€
- **åä½œ**ï¼šä¸¤è€…é…åˆå®Œæˆå¤æ‚çš„ä¸šåŠ¡éœ€æ±‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åä½œæ¶æ„


**å•ç‹¬ä½¿ç”¨çš„å±€é™æ€§ï¼š**

```
åªç”¨Filterçš„é—®é¢˜ï¼š
âŒ æ— æ³•ç›‘æ§åº”ç”¨å…¨å±€çŠ¶æ€
âŒ éš¾ä»¥ç»Ÿè®¡é•¿æœŸæ•°æ®
âŒ æ— æ³•å“åº”åº”ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶

åªç”¨Listenerçš„é—®é¢˜ï¼š
âŒ æ— æ³•å¤„ç†å…·ä½“è¯·æ±‚
âŒ æ— æ³•ä¿®æ”¹è¯·æ±‚å“åº”å†…å®¹
âŒ æ— æ³•åšè¯·æ±‚çº§åˆ«çš„æ§åˆ¶
```

**åä½œçš„ä¼˜åŠ¿ï¼š**
```
âœ… Filterå¤„ç†è¯·æ±‚ï¼ŒListenerç›‘æ§çŠ¶æ€
âœ… Filteræ”¶é›†æ•°æ®ï¼ŒListenerç»Ÿè®¡åˆ†æ  
âœ… Filteråšå®æ—¶æ§åˆ¶ï¼ŒListeneråšå…¨å±€ç®¡ç†
âœ… èŒè´£æ¸…æ™°ï¼ŒåŠŸèƒ½äº’è¡¥
```

### 1.3 åä½œæ¶æ„çš„åº”ç”¨åœºæ™¯


**å…¸å‹åº”ç”¨åœºæ™¯ï¼š**

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ Webåº”ç”¨ç›‘æ§ç³»ç»Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Filter: è®°å½•è¯·æ±‚ä¿¡æ¯ã€æ£€æŸ¥æƒé™ã€é™æµ            â”‚
â”‚ Listener: ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·ã€ç›‘æ§ç³»ç»Ÿæ€§èƒ½            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” å®‰å…¨é˜²æŠ¤ç³»ç»Ÿ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Filter: é˜²SQLæ³¨å…¥ã€XSSæ”»å‡»æ£€æµ‹                  â”‚
â”‚ Listener: è®°å½•å®‰å…¨äº‹ä»¶ã€å¼‚å¸¸è¡Œä¸ºåˆ†æ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

## 2. ğŸ¢ åˆ†å±‚æ¶æ„è®¾è®¡


### 2.1 æ¶æ„å±‚æ¬¡åˆ’åˆ†


**ä¸‰å±‚åä½œæ¶æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     è¡¨ç°å±‚ (Webå±‚)       â”‚ â† ç”¨æˆ·äº¤äº’ã€é¡µé¢å±•ç¤º
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     è¿‡æ»¤å±‚ (Filterå±‚)    â”‚ â† è¯·æ±‚è¿‡æ»¤ã€æƒé™æ§åˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ç›‘å¬å±‚ (Listenerå±‚)  â”‚ â† çŠ¶æ€ç›‘å¬ã€æ•°æ®ç»Ÿè®¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ä¸šåŠ¡å±‚ (Serviceå±‚)   â”‚ â† ä¸šåŠ¡é€»è¾‘å¤„ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å„å±‚èŒè´£è¯´æ˜


**ğŸ”¸ è¡¨ç°å±‚ï¼ˆWebå±‚ï¼‰**
- **ä½œç”¨**ï¼šç›´æ¥ä¸ç”¨æˆ·äº¤äº’
- **ç»„ä»¶**ï¼šServletã€JSPã€Controller
- **èŒè´£**ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œè¿”å›å“åº”ç»“æœ

**ğŸ”¸ è¿‡æ»¤å±‚ï¼ˆFilterå±‚ï¼‰**
- **ä½œç”¨**ï¼šè¯·æ±‚çš„å®ˆé—¨å‘˜
- **ç»„ä»¶**ï¼šå„ç§Filterå®ç°
- **èŒè´£**ï¼š
  - è¯·æ±‚é¢„å¤„ç†ï¼ˆç¼–ç ã€æƒé™æ£€æŸ¥ï¼‰
  - å“åº”åå¤„ç†ï¼ˆå‹ç¼©ã€åŠ å¯†ï¼‰
  - æ•°æ®æ”¶é›†å’Œä¼ é€’

**ğŸ”¸ ç›‘å¬å±‚ï¼ˆListenerå±‚ï¼‰**
- **ä½œç”¨**ï¼šåº”ç”¨çš„ç›‘æ§å‘˜
- **ç»„ä»¶**ï¼šå„ç§Listenerå®ç°  
- **èŒè´£**ï¼š
  - ç›‘å¬åº”ç”¨ç”Ÿå‘½å‘¨æœŸ
  - ç»Ÿè®¡å’Œåˆ†ææ•°æ®
  - èµ„æºç®¡ç†å’Œæ¸…ç†

### 2.3 åˆ†å±‚æ¶æ„å®ä¾‹


> ğŸ“Œ **å®é™…æ¡ˆä¾‹**ï¼šç”¨æˆ·ç™»å½•ç›‘æ§ç³»ç»Ÿ

**æ¶æ„å›¾ç¤ºï¼š**
```
ç”¨æˆ·ç™»å½•è¯·æ±‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LoginFilter        â”‚ â† éªŒè¯ç”¨æˆ·æƒé™ï¼Œè®°å½•ç™»å½•ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SessionListener    â”‚ â† ç›‘å¬Sessionåˆ›å»º/é”€æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚  LoginServlet       â”‚ â† å¤„ç†ç™»å½•ä¸šåŠ¡é€»è¾‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åä½œæµç¨‹ï¼š**
1. **LoginFilter**å…ˆæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
2. æœªç™»å½•åˆ™æ”¶é›†ç™»å½•ä¿¡æ¯ä¼ é€’ç»™Servlet
3. **SessionListener**ç›‘å¬åˆ°æ–°Sessionåˆ›å»º
4. **LoginServlet**å®Œæˆç™»å½•ä¸šåŠ¡å¤„ç†
5. **SessionListener**è®°å½•ç”¨æˆ·ç™»å½•ç»Ÿè®¡ä¿¡æ¯

---

## 3. âš–ï¸ èŒè´£è¾¹ç•Œåˆ’åˆ†


### 3.1 Filterçš„ä¸“å±èŒè´£


> ğŸ’¡ **Filterå°±åƒä¿å®‰**ï¼šä¸»è¦è´Ÿè´£"ç®¡è¿›ç®¡å‡º"

**ğŸ”¸ è¯·æ±‚å¤„ç†èŒè´£**
```
â”œâ”€ è¯·æ±‚é¢„å¤„ç†
â”‚  â”œâ”€ ç¼–ç è®¾ç½®ï¼šrequest.setCharacterEncoding("UTF-8")
â”‚  â”œâ”€ æƒé™æ£€æŸ¥ï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®æƒé™
â”‚  â””â”€ å‚æ•°éªŒè¯ï¼šæ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦åˆæ³•
â”‚
â”œâ”€ å“åº”åå¤„ç†  
â”‚  â”œâ”€ å†…å®¹å‹ç¼©ï¼šå‡å°‘ä¼ è¾“æ•°æ®é‡
â”‚  â”œâ”€ å¤´ä¿¡æ¯è®¾ç½®ï¼šå®‰å…¨å¤´ã€ç¼“å­˜å¤´
â”‚  â””â”€ æ ¼å¼è½¬æ¢ï¼šJSONã€XMLæ ¼å¼å¤„ç†
â”‚
â””â”€ æ•°æ®ä¼ é€’
   â”œâ”€ å‘ä¸‹ä¼ é€’ï¼šrequest.setAttribute()
   â””â”€ å‘ä¸Šæ±‡æŠ¥ï¼šé€šçŸ¥Listenerå¤„ç†ç»“æœ
```

**Filteré€‚åˆå¤„ç†çš„åœºæ™¯ï¼š**
- âœ… éœ€è¦ä¿®æ”¹è¯·æ±‚æˆ–å“åº”çš„å†…å®¹
- âœ… éœ€è¦é˜»æ­¢æŸäº›è¯·æ±‚ç»§ç»­æ‰§è¡Œ  
- âœ… éœ€è¦åœ¨è¯·æ±‚å¤„ç†å‰ååšç‰¹å®šæ“ä½œ
- âœ… éœ€è¦æ”¶é›†å•æ¬¡è¯·æ±‚çš„æ•°æ®

### 3.2 Listenerçš„ä¸“å±èŒè´£


> ğŸ’¡ **Listenerå°±åƒç›‘æ§å‘˜**ï¼šä¸»è¦è´Ÿè´£"çœ‹ç€è®°ç€"

**ğŸ”¸ ç›‘å¬ç®¡ç†èŒè´£**
```
â”œâ”€ ç”Ÿå‘½å‘¨æœŸç›‘å¬
â”‚  â”œâ”€ åº”ç”¨å¯åŠ¨ï¼šåˆå§‹åŒ–å…¨å±€èµ„æº
â”‚  â”œâ”€ åº”ç”¨å…³é—­ï¼šæ¸…ç†å’Œä¿å­˜æ•°æ®
â”‚  â””â”€ å¯¹è±¡åˆ›å»ºé”€æ¯ï¼šSessionã€Requestç”Ÿå‘½å‘¨æœŸ
â”‚
â”œâ”€ çŠ¶æ€å˜åŒ–ç›‘å¬
â”‚  â”œâ”€ å±æ€§å˜åŒ–ï¼šç›‘å¬Sessionã€Requestå±æ€§å˜åŒ–
â”‚  â”œâ”€ æ•°æ®ç»Ÿè®¡ï¼šç”¨æˆ·æ•°é‡ã€è¯·æ±‚ç»Ÿè®¡
â”‚  â””â”€ å¼‚å¸¸ç›‘æ§ï¼šç³»ç»Ÿå¼‚å¸¸ã€æ€§èƒ½é—®é¢˜
â”‚
â””â”€ å…¨å±€æ•°æ®ç®¡ç†
   â”œâ”€ ç¼“å­˜ç®¡ç†ï¼šå…¨å±€ç¼“å­˜çš„ç»´æŠ¤
   â”œâ”€ é…ç½®ç®¡ç†ï¼šç³»ç»Ÿé…ç½®çš„åŠ¨æ€æ›´æ–°
   â””â”€ èµ„æºç®¡ç†ï¼šæ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± 
```

**Listeneré€‚åˆå¤„ç†çš„åœºæ™¯ï¼š**
- âœ… éœ€è¦ç›‘æ§åº”ç”¨å…¨å±€çŠ¶æ€
- âœ… éœ€è¦ç»Ÿè®¡é•¿æœŸç´¯ç§¯æ•°æ®
- âœ… éœ€è¦ç®¡ç†å…¨å±€å…±äº«èµ„æº
- âœ… éœ€è¦å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶

### 3.3 åä½œè¾¹ç•ŒåŸåˆ™


**ğŸ¯ èŒè´£è¾¹ç•Œæ¸…æ™°åŒ–åŸåˆ™ï¼š**

| å¤„ç†ç±»å‹ | **Filterè´Ÿè´£** | **Listenerè´Ÿè´£** | **åä½œæ–¹å¼** |
|---------|---------------|----------------|-------------|
| **æ•°æ®å¤„ç†** | `å•æ¬¡è¯·æ±‚æ•°æ®å¤„ç†` | `ç´¯ç§¯ç»Ÿè®¡æ•°æ®ç®¡ç†` | `Filteræ”¶é›†â†’Listenerç»Ÿè®¡` |
| **æƒé™æ§åˆ¶** | `è¯·æ±‚çº§æƒé™æ£€æŸ¥` | `ç”¨æˆ·çŠ¶æ€ç›‘æ§` | `FilteréªŒè¯â†’Listenerè®°å½•` |
| **èµ„æºç®¡ç†** | `è¯·æ±‚çº§èµ„æºä½¿ç”¨` | `å…¨å±€èµ„æºç®¡ç†` | `Filterç”³è¯·â†’Listeneråˆ†é…` |
| **å¼‚å¸¸å¤„ç†** | `è¯·æ±‚å¼‚å¸¸å¤„ç†` | `ç³»ç»Ÿå¼‚å¸¸ç›‘æ§` | `Filteræ•è·â†’Listeneråˆ†æ` |

---

## 4. ğŸ§© æ¨¡å—åŒ–ç»„ç»‡


### 4.1 æ¨¡å—åˆ’åˆ†åŸåˆ™


**æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†ï¼š**

```
JavaWebåº”ç”¨æ¨¡å—ç»“æ„
â”œâ”€ ğŸ” å®‰å…¨æ¨¡å— (Security Module)
â”‚  â”œâ”€ AuthenticationFilter    (èº«ä»½è®¤è¯è¿‡æ»¤å™¨)
â”‚  â”œâ”€ AuthorizationFilter     (æƒé™æ§åˆ¶è¿‡æ»¤å™¨)  
â”‚  â”œâ”€ SessionSecurityListener (ä¼šè¯å®‰å…¨ç›‘å¬å™¨)
â”‚  â””â”€ LoginSecurityListener   (ç™»å½•å®‰å…¨ç›‘å¬å™¨)
â”‚
â”œâ”€ ğŸ“Š ç›‘æ§æ¨¡å— (Monitor Module)
â”‚  â”œâ”€ PerformanceFilter       (æ€§èƒ½ç›‘æ§è¿‡æ»¤å™¨)
â”‚  â”œâ”€ LoggingFilter          (æ—¥å¿—è®°å½•è¿‡æ»¤å™¨)
â”‚  â”œâ”€ SystemMonitorListener  (ç³»ç»Ÿç›‘æ§ç›‘å¬å™¨)
â”‚  â””â”€ StatisticsListener     (ç»Ÿè®¡åˆ†æç›‘å¬å™¨)
â”‚
â”œâ”€ ğŸ”§ å·¥å…·æ¨¡å— (Utility Module)  
â”‚  â”œâ”€ EncodingFilter         (ç¼–ç è®¾ç½®è¿‡æ»¤å™¨)
â”‚  â”œâ”€ CompressionFilter      (å‹ç¼©å¤„ç†è¿‡æ»¤å™¨)
â”‚  â””â”€ ResourceListener       (èµ„æºç®¡ç†ç›‘å¬å™¨)
â”‚
â””â”€ ğŸ’¼ ä¸šåŠ¡æ¨¡å— (Business Module)
   â”œâ”€ BusinessFilter         (ä¸šåŠ¡é€»è¾‘è¿‡æ»¤å™¨)
   â””â”€ BusinessListener       (ä¸šåŠ¡çŠ¶æ€ç›‘å¬å™¨)
```

### 4.2 æ¨¡å—é—´é€šä¿¡æ–¹å¼


**ğŸ”¸ äº‹ä»¶é©±åŠ¨é€šä¿¡**

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒå¾®ä¿¡ç¾¤èŠï¼Œä¸€ä¸ªäººå‘æ¶ˆæ¯ï¼Œå…¶ä»–äººéƒ½èƒ½æ”¶åˆ°

```java
// äº‹ä»¶å®šä¹‰
public class UserLoginEvent {
    private String username;
    private Date loginTime;
    private String ipAddress;
    
    // æ„é€ æ–¹æ³•å’Œgetter/setter
}

// Filterå‘é€äº‹ä»¶  
public class LoginFilter implements Filter {
    public void doFilter(ServletRequest request, 
                        ServletResponse response, 
                        FilterChain chain) {
        // ç”¨æˆ·ç™»å½•æˆåŠŸå
        UserLoginEvent event = new UserLoginEvent(username, new Date(), ip);
        
        // é€šçŸ¥æ‰€æœ‰ç›‘å¬å™¨
        request.getServletContext().setAttribute("loginEvent", event);
    }
}

// Listeneræ¥æ”¶äº‹ä»¶
public class LoginStatisticsListener implements ServletContextAttributeListener {
    public void attributeAdded(ServletContextAttributeEvent event) {
        if ("loginEvent".equals(event.getName())) {
            UserLoginEvent loginEvent = (UserLoginEvent) event.getValue();
            // æ›´æ–°ç™»å½•ç»Ÿè®¡ä¿¡æ¯
            updateLoginStatistics(loginEvent);
        }
    }
}
```

### 4.3 é…ç½®ç®¡ç†æ¨¡å—åŒ–


**ğŸ”¸ ç»Ÿä¸€é…ç½®ç®¡ç†**

```xml
<!-- web.xmlä¸­æ¨¡å—åŒ–é…ç½® -->
<!-- å®‰å…¨æ¨¡å—é…ç½® -->
<filter>
    <filter-name>SecurityFilterChain</filter-name>
    <filter-class>com.example.security.SecurityFilterChain</filter-class>
    <init-param>
        <param-name>config-file</param-name>
        <param-value>security-config.xml</param-value>
    </init-param>
</filter>

<!-- ç›‘æ§æ¨¡å—é…ç½® -->  
<listener>
    <listener-class>com.example.monitor.MonitoringListener</listener-class>
</listener>
```

**ğŸ”¸ æ¨¡å—ç‹¬ç«‹é…ç½®æ–‡ä»¶**

```
config/
â”œâ”€ security-config.xml        (å®‰å…¨æ¨¡å—é…ç½®)
â”œâ”€ monitor-config.xml         (ç›‘æ§æ¨¡å—é…ç½®)  
â”œâ”€ utility-config.xml         (å·¥å…·æ¨¡å—é…ç½®)
â””â”€ business-config.xml        (ä¸šåŠ¡æ¨¡å—é…ç½®)
```

---

## 5. ğŸš€ å¯æ‰©å±•æ€§è®¾è®¡


### 5.1 æ’ä»¶åŒ–æ¶æ„è®¾è®¡


**ğŸ”¸ æ’ä»¶æ¥å£å®šä¹‰**

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒæ‰‹æœºçš„APPï¼Œå®šä¹‰äº†ç»Ÿä¸€çš„å®‰è£…æ¥å£ï¼Œä»»ä½•ç¬¦åˆè§„èŒƒçš„APPéƒ½èƒ½å®‰è£…ä½¿ç”¨

```java
// é€šç”¨æ’ä»¶æ¥å£
public interface WebPlugin {
    // æ’ä»¶åˆå§‹åŒ–
    void init(FilterConfig config) throws ServletException;
    
    // æ’ä»¶å¤„ç†é€»è¾‘
    void process(ServletRequest request, ServletResponse response) 
        throws IOException, ServletException;
        
    // æ’ä»¶é”€æ¯
    void destroy();
    
    // æ’ä»¶ä¿¡æ¯
    PluginInfo getPluginInfo();
}

// æ’ä»¶ä¿¡æ¯ç±»
public class PluginInfo {
    private String name;        // æ’ä»¶åç§°
    private String version;     // ç‰ˆæœ¬å·
    private String description; // æè¿°ä¿¡æ¯
    private int priority;       // æ‰§è¡Œä¼˜å…ˆçº§
}
```

### 5.2 åŠ¨æ€åŠ è½½æœºåˆ¶


**ğŸ”¸ æ’ä»¶åŠ¨æ€æ³¨å†Œ**

```java
public class PluginManager {
    private Map<String, WebPlugin> plugins = new HashMap<>();
    
    // æ³¨å†Œæ’ä»¶
    public void registerPlugin(String name, WebPlugin plugin) {
        plugins.put(name, plugin);
        // æŒ‰ä¼˜å…ˆçº§æ’åº
        sortPluginsByPriority();
    }
    
    // æ‰§è¡Œæ‰€æœ‰æ’ä»¶
    public void executePlugins(ServletRequest request, ServletResponse response) {
        for (WebPlugin plugin : plugins.values()) {
            plugin.process(request, response);
        }
    }
}
```

### 5.3 é…ç½®é©±åŠ¨æ‰©å±•


**ğŸ”¸ å¯é…ç½®çš„åŠŸèƒ½å¼€å…³**

```
# application.properties
# åŠŸèƒ½æ¨¡å—å¼€å…³é…ç½®
security.authentication.enabled=true
security.authorization.enabled=true
monitor.performance.enabled=true
monitor.logging.enabled=false

# æ‰©å±•æ’ä»¶é…ç½®
plugins.custom.enabled=true
plugins.custom.classes=com.example.CustomPlugin,com.example.AnotherPlugin
```

**æ‰©å±•ç¤ºä¾‹åœºæ™¯ï¼š**

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ æ–°å¢éœ€æ±‚ï¼šAPIé™æµåŠŸèƒ½                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. å®ç°RateLimitPluginæ¥å£                      â”‚
â”‚ 2. åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨è¯¥æ’ä»¶                       â”‚  
â”‚ 3. æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç                              â”‚
â”‚ 4. æ”¯æŒåŠ¨æ€å¼€å¯/å…³é—­                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

## 6. âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 6.1 Filteré“¾ä¼˜åŒ–


**ğŸ”¸ æ‰§è¡Œé¡ºåºä¼˜åŒ–**

> ğŸ’¡ **ä¼˜åŒ–åŸç†**ï¼šæŠŠæœ€å¯èƒ½æ‹’ç»è¯·æ±‚çš„Filteræ”¾åœ¨å‰é¢ï¼Œå‡å°‘ä¸å¿…è¦çš„å¤„ç†

```
ä¼˜åŒ–å‰çš„Filteré¡ºåºï¼š
EncodingFilter â†’ LoggingFilter â†’ AuthenticationFilter â†’ AuthorizationFilter

é—®é¢˜ï¼šæœªæˆæƒç”¨æˆ·ä¹Ÿä¼šæ‰§è¡Œç¼–ç å’Œæ—¥å¿—å¤„ç†

ä¼˜åŒ–åçš„Filteré¡ºåºï¼š  
AuthenticationFilter â†’ AuthorizationFilter â†’ EncodingFilter â†’ LoggingFilter

æ•ˆæœï¼šæœªæˆæƒç”¨æˆ·ç›´æ¥è¢«æ‹¦æˆªï¼ŒèŠ‚çœCPUèµ„æº
```

**ğŸ”¸ æ¡ä»¶æ‰§è¡Œä¼˜åŒ–**

```java
public class SmartFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String path = httpRequest.getRequestURI();
        
        // é™æ€èµ„æºè·³è¿‡å¤æ‚å¤„ç†
        if (isStaticResource(path)) {
            chain.doFilter(request, response);
            return;
        }
        
        // åªå¯¹éœ€è¦çš„è¯·æ±‚è¿›è¡Œå¤æ‚å¤„ç†
        if (needsComplexProcessing(path)) {
            doComplexProcessing(request, response);
        }
        
        chain.doFilter(request, response);
    }
}
```

### 6.2 Listeneræ€§èƒ½ä¼˜åŒ–


**ğŸ”¸ å¼‚æ­¥å¤„ç†ä¼˜åŒ–**

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒå¿«é€’å°å“¥ï¼Œä¸ç”¨ç­‰å®¢æˆ·ç­¾æ”¶å®Œæ‰å»é€ä¸‹ä¸€ä»¶ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡

```java
public class AsyncStatisticsListener implements HttpSessionListener {
    private ExecutorService executor = Executors.newFixedThreadPool(5);
    
    @Override
    public void sessionCreated(HttpSessionEvent event) {
        // å¼‚æ­¥å¤„ç†ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
        executor.submit(() -> {
            updateUserStatistics(event.getSession());
        });
    }
    
    @Override  
    public void sessionDestroyed(HttpSessionEvent event) {
        executor.submit(() -> {
            cleanupUserData(event.getSession());
        });
    }
}
```

### 6.3 å†…å­˜ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ æ•°æ®ç¼“å­˜ä¼˜åŒ–**

```java
public class CacheOptimizedListener {
    // ä½¿ç”¨LRUç¼“å­˜ï¼Œè‡ªåŠ¨æ¸…ç†æ—§æ•°æ®
    private Map<String, UserStats> userCache = 
        Collections.synchronizedMap(new LinkedHashMap<String, UserStats>(1000, 0.75f, true) {
            protected boolean removeEldestEntry(Map.Entry<String, UserStats> eldest) {
                return size() > 1000; // æœ€å¤šç¼“å­˜1000ä¸ªç”¨æˆ·æ•°æ®
            }
        });
}
```

**æ€§èƒ½ç›‘æ§æŒ‡æ ‡ï¼š**

| æŒ‡æ ‡ç±»å‹ | **ç›‘æ§å†…å®¹** | **ä¼˜åŒ–ç›®æ ‡** | **å®ç°æ–¹å¼** |
|---------|-------------|-------------|-------------|
| **å“åº”æ—¶é—´** | `Filterå¤„ç†æ—¶é—´` | `< 10ms` | `è®¡æ—¶å™¨ç»Ÿè®¡` |
| **å†…å­˜ä½¿ç”¨** | `Listenerç¼“å­˜å¤§å°` | `< 100MB` | `JVMç›‘æ§` |
| **CPUåˆ©ç”¨ç‡** | `å¤„ç†çº¿ç¨‹å ç”¨ç‡` | `< 70%` | `çº¿ç¨‹æ± ç›‘æ§` |
| **ååé‡** | `æ¯ç§’å¤„ç†è¯·æ±‚æ•°` | `> 1000 RPS` | `è®¡æ•°å™¨ç»Ÿè®¡` |

---

## 7. ğŸ”§ å¯ç»´æŠ¤æ€§ä¿è¯


### 7.1 æ—¥å¿—ç®¡ç†ç­–ç•¥


**ğŸ”¸ åˆ†çº§æ—¥å¿—è®°å½•**

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒåŒ»é™¢çš„ç—…å†ç³»ç»Ÿï¼Œä¸åŒä¸¥é‡ç¨‹åº¦çš„é—®é¢˜è®°å½•åœ¨ä¸åŒçº§åˆ«

```java
public class LoggingFilter implements Filter {
    private Logger logger = LoggerFactory.getLogger(LoggingFilter.class);
    
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        long startTime = System.currentTimeMillis();
        String requestInfo = getRequestInfo(request);
        
        try {
            // DEBUGçº§åˆ«ï¼šè®°å½•è¯¦ç»†çš„è¯·æ±‚ä¿¡æ¯
            logger.debug("å¤„ç†è¯·æ±‚: {}", requestInfo);
            
            chain.doFilter(request, response);
            
            long duration = System.currentTimeMillis() - startTime;
            
            // INFOçº§åˆ«ï¼šè®°å½•æ­£å¸¸çš„å¤„ç†ç»“æœ
            logger.info("è¯·æ±‚å¤„ç†å®Œæˆ: {} (è€—æ—¶: {}ms)", requestInfo, duration);
            
        } catch (Exception e) {
            // ERRORçº§åˆ«ï¼šè®°å½•å¼‚å¸¸ä¿¡æ¯
            logger.error("è¯·æ±‚å¤„ç†å¤±è´¥: {} - {}", requestInfo, e.getMessage(), e);
            throw e;
        }
    }
}
```

### 7.2 é…ç½®å¤–éƒ¨åŒ–


**ğŸ”¸ ç¯å¢ƒç›¸å…³é…ç½®åˆ†ç¦»**

```
config/
â”œâ”€ dev/                    (å¼€å‘ç¯å¢ƒé…ç½®)
â”‚  â”œâ”€ filter-config.xml
â”‚  â””â”€ listener-config.xml
â”œâ”€ test/                   (æµ‹è¯•ç¯å¢ƒé…ç½®)
â”‚  â”œâ”€ filter-config.xml    
â”‚  â””â”€ listener-config.xml
â””â”€ prod/                   (ç”Ÿäº§ç¯å¢ƒé…ç½®)
   â”œâ”€ filter-config.xml
   â””â”€ listener-config.xml
```

**ğŸ”¸ çƒ­æ›´æ–°é…ç½®**

```java
public class ConfigurableFilter implements Filter {
    private Properties config;
    private long lastModified;
    
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦éœ€è¦é‡æ–°åŠ è½½
        reloadConfigIfNeeded();
        
        // ä½¿ç”¨æœ€æ–°çš„é…ç½®è¿›è¡Œå¤„ç†
        processWithCurrentConfig(request, response, chain);
    }
    
    private void reloadConfigIfNeeded() {
        File configFile = new File("config/filter.properties");
        if (configFile.lastModified() > lastModified) {
            loadConfiguration(configFile);
            lastModified = configFile.lastModified();
        }
    }
}
```

### 7.3 é”™è¯¯å¤„ç†æœºåˆ¶


**ğŸ”¸ å¼‚å¸¸ä¼ æ’­æ§åˆ¶**

```java
public class RobustFilter implements Filter {
    
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        try {
            // æ ¸å¿ƒå¤„ç†é€»è¾‘
            doCoreProcessing(request, response);
            chain.doFilter(request, response);
            
        } catch (BusinessException e) {
            // ä¸šåŠ¡å¼‚å¸¸ï¼šè®°å½•å¹¶å‹å¥½æç¤º
            logger.warn("ä¸šåŠ¡å¤„ç†å¼‚å¸¸: {}", e.getMessage());
            handleBusinessError(request, response, e);
            
        } catch (SystemException e) {
            // ç³»ç»Ÿå¼‚å¸¸ï¼šè®°å½•è¯¦ç»†ä¿¡æ¯ä½†ç»§ç»­å¤„ç†
            logger.error("ç³»ç»Ÿå¼‚å¸¸ï¼Œä½†ç»§ç»­å¤„ç†: {}", e.getMessage(), e);
            chain.doFilter(request, response);
            
        } catch (Exception e) {
            // æœªçŸ¥å¼‚å¸¸ï¼šè®°å½•å¹¶é˜»æ­¢ç»§ç»­å¤„ç†
            logger.error("ä¸¥é‡å¼‚å¸¸ï¼Œç»ˆæ­¢å¤„ç†: {}", e.getMessage(), e);
            handleSevereError(request, response, e);
        }
    }
}
```

**ç»´æŠ¤æ€§æ£€æŸ¥æ¸…å•ï¼š**

- [ ] **ä»£ç æ³¨é‡Š**ï¼šå…³é”®é€»è¾‘æœ‰æ¸…æ¥šçš„ä¸­æ–‡æ³¨é‡Š
- [ ] **é”™è¯¯å¤„ç†**ï¼šå¼‚å¸¸æƒ…å†µæœ‰åˆç†çš„å¤„ç†æœºåˆ¶  
- [ ] **æ—¥å¿—è®°å½•**ï¼šé‡è¦æ“ä½œæœ‰è¯¦ç»†çš„æ—¥å¿—è®°å½•
- [ ] **é…ç½®ç®¡ç†**ï¼šå¯é…ç½®é¡¹éƒ½å¤–éƒ¨åŒ–ç®¡ç†
- [ ] **æ€§èƒ½ç›‘æ§**ï¼šæœ‰æ€§èƒ½æŒ‡æ ‡çš„ç›‘æ§å’Œå‘Šè­¦
- [ ] **æ–‡æ¡£æ›´æ–°**ï¼šä»£ç å˜æ›´åŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åä½œæ¶æ„ï¼šFilterå¤„ç†è¯·æ±‚ï¼ŒListenerç›‘æ§çŠ¶æ€ï¼Œä¸¤è€…é…åˆå®Œæˆå¤æ‚éœ€æ±‚
ğŸ”¸ åˆ†å±‚è®¾è®¡ï¼šè¡¨ç°å±‚ã€è¿‡æ»¤å±‚ã€ç›‘å¬å±‚ã€ä¸šåŠ¡å±‚ï¼Œå„å¸å…¶èŒ  
ğŸ”¸ èŒè´£è¾¹ç•Œï¼šFilterç®¡"è¿›å‡º"ï¼ŒListenerç®¡"ç›‘æ§"ï¼Œåä½œä¸å†²çª
ğŸ”¸ æ¨¡å—åŒ–ç»„ç»‡ï¼šæŒ‰åŠŸèƒ½åˆ’åˆ†æ¨¡å—ï¼Œä¾¿äºç®¡ç†å’Œæ‰©å±•
ğŸ”¸ å¯æ‰©å±•è®¾è®¡ï¼šæ’ä»¶åŒ–æ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ æ–°åŠŸèƒ½
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæ‰§è¡Œé¡ºåºä¼˜åŒ–ã€å¼‚æ­¥å¤„ç†ã€å†…å­˜ç®¡ç†
ğŸ”¸ å¯ç»´æŠ¤æ€§ï¼šå®Œå–„çš„æ—¥å¿—ã€é…ç½®å¤–éƒ¨åŒ–ã€å¼‚å¸¸å¤„ç†æœºåˆ¶
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ç”¨Filterï¼Œä»€ä¹ˆæ—¶å€™ç”¨Listener**
```
ç”¨Filterçš„åœºæ™¯ï¼š
â€¢ éœ€è¦ä¿®æ”¹è¯·æ±‚æˆ–å“åº”å†…å®¹
â€¢ éœ€è¦åœ¨è¯·æ±‚å¤„ç†å‰ååšæ£€æŸ¥
â€¢ éœ€è¦é˜»æ­¢æŸäº›è¯·æ±‚ç»§ç»­æ‰§è¡Œ
â€¢ éœ€è¦æ”¶é›†å•æ¬¡è¯·æ±‚çš„æ•°æ®

ç”¨Listenerçš„åœºæ™¯ï¼š  
â€¢ éœ€è¦ç›‘æ§åº”ç”¨å…¨å±€çŠ¶æ€
â€¢ éœ€è¦ç»Ÿè®¡ç´¯ç§¯çš„ä¸šåŠ¡æ•°æ®
â€¢ éœ€è¦ç®¡ç†å…¨å±€å…±äº«èµ„æº
â€¢ éœ€è¦å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
```

**ğŸ”¹ åä½œçš„æ ¸å¿ƒåŸåˆ™**
```
æ•°æ®æµå‘ï¼šFilteræ”¶é›† â†’ Listenerç»Ÿè®¡
å¤„ç†æ—¶æœºï¼šFilterå®æ—¶å¤„ç† â†’ Listenerå¼‚æ­¥åˆ†æ  
ä½œç”¨èŒƒå›´ï¼šFilterå•æ¬¡è¯·æ±‚ â†’ Listenerå…¨å±€åº”ç”¨
èŒè´£åˆ†å·¥ï¼šFilteråšæ§åˆ¶ â†’ Listeneråšç›‘æ§
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¼ä¸šçº§åº”ç”¨åœºæ™¯ï¼š**
- **ç”µå•†ç³»ç»Ÿ**ï¼šFilterå¤„ç†ç”¨æˆ·æƒé™ï¼ŒListenerç»Ÿè®¡è®¿é—®æ•°æ®
- **å†…å®¹ç®¡ç†**ï¼šFilterè¿‡æ»¤æ•æ„Ÿå†…å®¹ï¼ŒListenerè®°å½•å®¡æ ¸æ—¥å¿—  
- **APIç½‘å…³**ï¼šFilteråšè¯·æ±‚è·¯ç”±ï¼ŒListenerç›‘æ§æœåŠ¡çŠ¶æ€
- **ç›‘æ§å¹³å°**ï¼šFilteræ”¶é›†æ€§èƒ½æ•°æ®ï¼ŒListeneråˆ†æç³»ç»Ÿå¥åº·åº¦

**ğŸ¯ å­¦ä¹ å»ºè®®ï¼š**
1. **å…ˆå•ç‹¬æŒæ¡**ï¼šåˆ†åˆ«ç†Ÿç»ƒFilterå’ŒListenerçš„ä½¿ç”¨
2. **å†å­¦åä½œ**ï¼šç†è§£ä¸¤è€…å¦‚ä½•é…åˆè§£å†³å¤æ‚é—®é¢˜
3. **å¤šåšå®è·µ**ï¼šé€šè¿‡å…·ä½“é¡¹ç›®ä½“ä¼šæ¶æ„è®¾è®¡çš„é‡è¦æ€§
4. **å…³æ³¨æ€§èƒ½**ï¼šåœ¨åŠŸèƒ½å®ç°åŸºç¡€ä¸Šè€ƒè™‘æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Filterå®ˆé—¨ç®¡è¿›å‡ºï¼ŒListenerç›‘æ§çœ‹å…¨å±€
- åä½œåˆ†å·¥èŒè´£æ¸…ï¼Œæ¨¡å—ç»„ç»‡æ˜“æ‰©å±•  
- æ€§èƒ½ä¼˜åŒ–è«å¿˜è®°ï¼Œå¯ç»´æŠ¤æ€§æ˜¯å…³é”®
- ç†è®ºå®è·µè¦ç»“åˆï¼Œä¼ä¸šåº”ç”¨è§çœŸç« 