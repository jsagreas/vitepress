---
title: 1ã€Filter-Listener-åä½œæœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [åä½œæœºåˆ¶åŸºç¡€ç†è§£](#1-åä½œæœºåˆ¶åŸºç¡€ç†è§£)
2. [æ‰§è¡Œæ—¶åºå…³ç³»è¯¦è§£](#2-æ‰§è¡Œæ—¶åºå…³ç³»è¯¦è§£)
3. [æ•°æ®å…±äº«æœºåˆ¶](#3-æ•°æ®å…±äº«æœºåˆ¶)
4. [äº‹ä»¶é€šä¿¡æ¨¡å¼](#4-äº‹ä»¶é€šä¿¡æ¨¡å¼)
5. [è´£ä»»é“¾æ¨¡å¼åº”ç”¨](#5-è´£ä»»é“¾æ¨¡å¼åº”ç”¨)
6. [è§‚å¯Ÿè€…æ¨¡å¼é›†æˆ](#6-è§‚å¯Ÿè€…æ¨¡å¼é›†æˆ)
7. [è®¾è®¡æ¨¡å¼æœ€ä½³å®è·µ](#7-è®¾è®¡æ¨¡å¼æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤ åä½œæœºåˆ¶åŸºç¡€ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯Filterä¸Listeneråä½œ


**ç®€å•ç†è§£**ï¼šå°±åƒé¤å…çš„æœåŠ¡æµç¨‹ä¸€æ ·

```
ç°å®é¤å…æœåŠ¡ï¼š                Filterä¸Listeneråä½œï¼š
å®¢äººè¿›é—¨ â†’ è¿å®¾(ç›‘å¬)         è¯·æ±‚åˆ°è¾¾ â†’ Listenerç›‘å¬
æ£€æŸ¥é¢„çº¦ â†’ éªŒè¯è¿‡æ»¤å™¨         èº«ä»½éªŒè¯ â†’ Filterè¿‡æ»¤  
å¼•å¯¼å°±åº§ â†’ çŠ¶æ€ç›‘å¬å™¨         ä¼šè¯ç®¡ç† â†’ Listenerè·Ÿè¸ª
ç‚¹èœæœåŠ¡ â†’ ä¸šåŠ¡å¤„ç†           Servletå¤„ç† â†’ æ ¸å¿ƒä¸šåŠ¡
ç»“è´¦ç¦»å¼€ â†’ æ¸…ç†ç›‘å¬å™¨         è¯·æ±‚ç»“æŸ â†’ Listeneræ¸…ç†
```

**ğŸ” æ ¸å¿ƒç†è§£**ï¼š
- **Filter**ï¼šåƒé—¨å«ï¼Œè´Ÿè´£æ£€æŸ¥å’Œè¿‡æ»¤
- **Listener**ï¼šåƒç®¡å®¶ï¼Œè´Ÿè´£ç›‘å¬å’Œç®¡ç†
- **åä½œ**ï¼šé—¨å«å’Œç®¡å®¶é…åˆï¼Œæä¾›å®Œæ•´æœåŠ¡

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åä½œ


**ğŸ¯ å•ç‹¬ä½¿ç”¨çš„å±€é™æ€§**ï¼š

| ç»„ä»¶ç±»å‹ | **å•ç‹¬èƒ½åŠ›** | **å±€é™æ€§** |
|---------|------------|-----------|
| ğŸšª **Filter** | `è¯·æ±‚æ‹¦æˆªã€å“åº”å¤„ç†` | `æ— æ³•ç›‘å¬å®¹å™¨äº‹ä»¶ï¼Œä¸çŸ¥é“åº”ç”¨çŠ¶æ€` |
| ğŸ‘‚ **Listener** | `äº‹ä»¶ç›‘å¬ã€çŠ¶æ€ç®¡ç†` | `æ— æ³•æ‹¦æˆªè¯·æ±‚ï¼Œä¸èƒ½ä¿®æ”¹è¯·æ±‚å“åº”` |

**ğŸ’¡ åä½œçš„ä»·å€¼**ï¼š
```
Filterçš„ä¼˜åŠ¿ï¼šèƒ½æ‹¦æˆªæ¯ä¸ªè¯·æ±‚
Listenerçš„ä¼˜åŠ¿ï¼šèƒ½æ„ŸçŸ¥åº”ç”¨çŠ¶æ€
åä½œæ•ˆæœï¼šFilteræ ¹æ®Listeneræä¾›çš„çŠ¶æ€ä¿¡æ¯åšæ›´æ™ºèƒ½çš„å¤„ç†
```

### 1.3 åä½œçš„å…¸å‹åœºæ™¯


**ğŸŒŸ å®é™…åº”ç”¨åœºæ™¯**ï¼š

**åœºæ™¯1ï¼šåœ¨çº¿ç”¨æˆ·ç»Ÿè®¡ä¸è®¿é—®æ§åˆ¶**
```
Listener: ç›‘å¬ç”¨æˆ·ç™»å½•/é€€å‡ºï¼Œç»´æŠ¤åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
Filter: æ ¹æ®åœ¨çº¿ç”¨æˆ·æ•°é‡ï¼Œå†³å®šæ˜¯å¦é™åˆ¶æ–°ç”¨æˆ·è®¿é—®

â”Œâ”€ ç”Ÿæ´»ç±»æ¯” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”µå½±é™¢æ»¡åº§æ£€æŸ¥ï¼š        â”‚
â”‚ ç®¡ç†å‘˜(Listener)ç»Ÿè®¡è§‚ä¼— â”‚
â”‚ æ£€ç¥¨å‘˜(Filter)æ§åˆ¶å…¥åœº  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯2ï¼šç³»ç»Ÿç›‘æ§ä¸è¯·æ±‚è®°å½•**
```
Listener: ç›‘å¬åº”ç”¨å¯åŠ¨/å…³é—­ï¼Œè®°å½•ç³»ç»ŸçŠ¶æ€
Filter: æ ¹æ®ç³»ç»ŸçŠ¶æ€ï¼Œå†³å®šè¯·æ±‚å¤„ç†ç­–ç•¥

å®é™…æ•ˆæœï¼š
- ç³»ç»Ÿæ­£å¸¸ï¼šæ­£å¸¸å¤„ç†è¯·æ±‚
- ç³»ç»Ÿç»´æŠ¤ï¼šè¿”å›ç»´æŠ¤é¡µé¢
- ç³»ç»Ÿè¿‡è½½ï¼šé™åˆ¶è®¿é—®é¢‘ç‡
```

---

## 2. â° æ‰§è¡Œæ—¶åºå…³ç³»è¯¦è§£


### 2.1 Webåº”ç”¨å¯åŠ¨æ—¶åº


**ğŸ“Š å¯åŠ¨æ‰§è¡Œé¡ºåº**ï¼š

```
Webåº”ç”¨å¯åŠ¨æµç¨‹ï¼š

ç¬¬1æ­¥ï¼šå®¹å™¨åˆå§‹åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tomcatå¯åŠ¨     â”‚
â”‚   åŠ è½½web.xml    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
ç¬¬2æ­¥ï¼šListeneråˆå§‹åŒ–ï¼ˆæŒ‰ç…§æ³¨å†Œé¡ºåºï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ServletContext   â”‚
â”‚ Listeneråˆå§‹åŒ–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
ç¬¬3æ­¥ï¼šFilteråˆå§‹åŒ–ï¼ˆæŒ‰ç…§æ³¨å†Œé¡ºåºï¼‰  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Filteråˆå§‹åŒ–    â”‚
â”‚   init()æ–¹æ³•     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
ç¬¬4æ­¥ï¼šServletåˆå§‹åŒ–ï¼ˆé¦–æ¬¡è®¿é—®æ—¶ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Servletåˆå§‹åŒ–   â”‚
â”‚   init()æ–¹æ³•     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è¯·æ±‚å¤„ç†æ—¶åº


**ğŸ”„ å•æ¬¡è¯·æ±‚çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**ï¼š

```
å®¢æˆ·ç«¯è¯·æ±‚å¤„ç†æµç¨‹ï¼š

å®¢æˆ·ç«¯å‘é€è¯·æ±‚
        â”‚
        â–¼
â‘ Listeneræ„ŸçŸ¥è¯·æ±‚åˆ°è¾¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ServletRequestListener  â”‚
â”‚ requestInitialized()    â”‚ â† ç›‘å¬å™¨æœ€å…ˆæ„ŸçŸ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â‘¡Filteré“¾å¼€å§‹æ‰§è¡Œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Filter1.doFilter()    â”‚ â† è¿‡æ»¤å™¨å¼€å§‹æ‹¦æˆª
â”‚   Filter2.doFilter()    â”‚
â”‚   Filter3.doFilter()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â‘¢åˆ°è¾¾ç›®æ ‡Servlet
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Servletå¤„ç†è¯·æ±‚       â”‚ â† æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   service()æ–¹æ³•         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â‘£Filteré“¾åå‘æ‰§è¡Œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Filter3å¤„ç†å“åº”       â”‚ â† å“åº”ç»è¿‡è¿‡æ»¤å™¨
â”‚   Filter2å¤„ç†å“åº”       â”‚
â”‚   Filter1å¤„ç†å“åº”       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â‘¤Listeneræ„ŸçŸ¥è¯·æ±‚ç»“æŸ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ServletRequestListener  â”‚
â”‚ requestDestroyed()      â”‚ â† ç›‘å¬å™¨æœ€åæ‰§è¡Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
å“åº”è¿”å›å®¢æˆ·ç«¯
```

### 2.3 å…³é”®æ—¶åºç†è§£


**âš ï¸ æ—¶åºé‡ç‚¹**ï¼š
```
è®°å¿†è¦ç‚¹ï¼š
1. Listeneræ€»æ˜¯æ¯”Filterå…ˆå¯åŠ¨
2. è¯·æ±‚æ—¶ï¼šListenerå…ˆæ„ŸçŸ¥ï¼ŒFilteråæ‰§è¡Œ
3. å“åº”æ—¶ï¼šFilterå…ˆå¤„ç†ï¼ŒListeneråæ¸…ç†
4. é”€æ¯æ—¶ï¼šFilterå…ˆé”€æ¯ï¼ŒListeneråé”€æ¯

æ—¶åºå£è¯€ï¼š
"ç›‘å¬å…ˆå¯ååœï¼Œè¿‡æ»¤å¤¹åœ¨ä¸­é—´"
```

---

## 3. ğŸ“Š æ•°æ®å…±äº«æœºåˆ¶


### 3.1 å…±äº«æ•°æ®çš„å­˜å‚¨ä½ç½®


**ğŸ  æ•°æ®å­˜å‚¨çš„å››ä¸ªåœ°æ–¹**ï¼š

```
Webåº”ç”¨ä¸­çš„æ•°æ®å…±äº«ç©ºé—´ï¼š

ğŸŒ å…¨å±€çº§åˆ« - ServletContext
â”œâ”€â”€ åº”ç”¨çº§é…ç½®ä¿¡æ¯
â”œâ”€â”€ å…¨å±€ç»Ÿè®¡æ•°æ®  
â””â”€â”€ å…±äº«èµ„æºå¯¹è±¡

ğŸ‘¤ ä¼šè¯çº§åˆ« - HttpSession  
â”œâ”€â”€ ç”¨æˆ·ç™»å½•çŠ¶æ€
â”œâ”€â”€ è´­ç‰©è½¦ä¿¡æ¯
â””â”€â”€ ä¸ªäººåå¥½è®¾ç½®

ğŸ“‹ è¯·æ±‚çº§åˆ« - HttpServletRequest
â”œâ”€â”€ å½“å‰è¯·æ±‚å‚æ•°
â”œâ”€â”€ å¤„ç†è¿‡ç¨‹æ•°æ®
â””â”€â”€ ä¸´æ—¶è®¡ç®—ç»“æœ

ğŸ“„ é¡µé¢çº§åˆ« - PageContext (JSP)
â””â”€â”€ é¡µé¢å†…ä¸´æ—¶æ•°æ®
```

### 3.2 Filterä¸Listeneræ•°æ®äº¤äº’


**ğŸ’¬ æ•°æ®äº¤äº’çš„ä¸‰ç§æ–¹å¼**ï¼š

**æ–¹å¼1ï¼šé€šè¿‡ServletContextå…±äº«å…¨å±€æ•°æ®**

```java
// Listenerè®¾ç½®å…¨å±€æ•°æ®
public class AppStatusListener implements ServletContextListener {
    @Override
    public void contextInitialized(ServletContextEvent event) {
        ServletContext context = event.getServletContext();
        // è®¾ç½®åº”ç”¨çŠ¶æ€
        context.setAttribute("appStatus", "RUNNING");
        // è®¾ç½®åœ¨çº¿ç”¨æˆ·è®¡æ•°
        context.setAttribute("onlineUsers", new AtomicInteger(0));
    }
}

// Filterè¯»å–å…¨å±€æ•°æ®åšåˆ¤æ–­
public class StatusFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        ServletContext context = request.getServletContext();
        String status = (String) context.getAttribute("appStatus");
        
        if ("MAINTENANCE".equals(status)) {
            // ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œè¿”å›ç»´æŠ¤é¡µé¢
            response.getWriter().write("ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œè¯·ç¨åè®¿é—®");
            return;
        }
        
        chain.doFilter(request, response); // ç»§ç»­å¤„ç†
    }
}
```

**æ–¹å¼2ï¼šé€šè¿‡Sessionå…±äº«ç”¨æˆ·æ•°æ®**

```java
// Listenerç›‘å¬ç”¨æˆ·ç™»å½•ï¼Œè®¾ç½®ç”¨æˆ·ä¿¡æ¯
public class UserSessionListener implements HttpSessionListener {
    @Override
    public void sessionCreated(HttpSessionEvent event) {
        HttpSession session = event.getSession();
        // è®°å½•ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶é—´
        session.setAttribute("firstAccessTime", new Date());
    }
}

// Filteræ£€æŸ¥ç”¨æˆ·æƒé™
public class AuthFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpSession session = httpRequest.getSession();
        
        Object user = session.getAttribute("currentUser");
        if (user == null) {
            // ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
            HttpServletResponse httpResponse = (HttpServletResponse) response;
            httpResponse.sendRedirect("/login.jsp");
            return;
        }
        
        chain.doFilter(request, response);
    }
}
```

### 3.3 æ•°æ®å…±äº«æœ€ä½³å®è·µ


**ğŸ“‹ æ•°æ®å…±äº«è®¾è®¡åŸåˆ™**ï¼š

| æ•°æ®ç±»å‹ | **æ¨èå­˜å‚¨ä½ç½®** | **è®¿é—®æ–¹å¼** | **æ³¨æ„äº‹é¡¹** |
|---------|----------------|-------------|-------------|
| ğŸŒ **å…¨å±€é…ç½®** | `ServletContext` | `getAttribute/setAttribute` | `çº¿ç¨‹å®‰å…¨ï¼Œè°¨æ…ä¿®æ”¹` |
| ğŸ‘¤ **ç”¨æˆ·çŠ¶æ€** | `HttpSession` | `session.getAttribute` | `æ³¨æ„è¶…æ—¶å¤„ç†` |
| ğŸ“ **è¯·æ±‚æ•°æ®** | `HttpServletRequest` | `request.getAttribute` | `ç”Ÿå‘½å‘¨æœŸçŸ­æš‚` |
| ğŸ“Š **ç»Ÿè®¡ä¿¡æ¯** | `ServletContext + çº¿ç¨‹å®‰å…¨ç±»` | `AtomicIntegerç­‰` | `å¹¶å‘å®‰å…¨` |

**ğŸ’¡ å…±äº«æ•°æ®çš„å‘½åè§„èŒƒ**ï¼š
```
æ¨èå‘½åæ–¹å¼ï¼š
- å…¨å±€æ•°æ®ï¼šapp.å‰ç¼€ï¼Œå¦‚ "app.onlineUserCount"
- ç”¨æˆ·æ•°æ®ï¼šuser.å‰ç¼€ï¼Œå¦‚ "user.loginInfo"  
- è¯·æ±‚æ•°æ®ï¼šreq.å‰ç¼€ï¼Œå¦‚ "req.processTime"
- ç³»ç»Ÿæ•°æ®ï¼šsys.å‰ç¼€ï¼Œå¦‚ "sys.startTime"

å¥½å¤„ï¼šé¿å…å‘½åå†²çªï¼Œä¾¿äºç®¡ç†ç»´æŠ¤
```

---

## 4. ğŸ“¡ äº‹ä»¶é€šä¿¡æ¨¡å¼


### 4.1 åŸºäºäº‹ä»¶çš„é€šä¿¡ç†è§£


**ğŸ”” äº‹ä»¶é€šä¿¡å°±åƒå¾®ä¿¡ç¾¤èŠ**ï¼š

```
å¾®ä¿¡ç¾¤èŠæ¨¡å¼ï¼š                Webäº‹ä»¶é€šä¿¡ï¼š
ç¾¤å‹å‘æ¶ˆæ¯ â†’ ç¾¤å†…å¹¿æ’­         ç”¨æˆ·æ“ä½œ â†’ è§¦å‘äº‹ä»¶
@æ‰€æœ‰äºº â†’ é€šçŸ¥æ‰€æœ‰æˆå‘˜         äº‹ä»¶å¹¿æ’­ â†’ é€šçŸ¥æ‰€æœ‰ç›‘å¬å™¨  
ç¾¤å‹å›å¤ â†’ å„è‡ªå¤„ç†           ç›‘å¬å™¨å“åº” â†’ å„è‡ªå¤„ç†é€»è¾‘

æ ¸å¿ƒç‰¹ç‚¹ï¼š
- å‘é€è€…ä¸å…³å¿ƒè°åœ¨ç›‘å¬
- ç›‘å¬è€…è‡ªä¸»å†³å®šå¦‚ä½•å“åº”  
- æ¾è€¦åˆï¼Œæ˜“äºæ‰©å±•
```

### 4.2 Webå®¹å™¨çš„äº‹ä»¶ç±»å‹


**ğŸ“‹ å®¹å™¨æä¾›çš„æ ‡å‡†äº‹ä»¶**ï¼š

```
Webåº”ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼š

ğŸ  åº”ç”¨çº§äº‹ä»¶ (ServletContext)
â”œâ”€â”€ contextInitialized    â†’ åº”ç”¨å¯åŠ¨
â”œâ”€â”€ contextDestroyed      â†’ åº”ç”¨å…³é—­  
â”œâ”€â”€ attributeAdded        â†’ å±æ€§æ·»åŠ 
â”œâ”€â”€ attributeRemoved      â†’ å±æ€§åˆ é™¤
â””â”€â”€ attributeReplaced     â†’ å±æ€§ä¿®æ”¹

ğŸ‘¤ ä¼šè¯çº§äº‹ä»¶ (HttpSession)  
â”œâ”€â”€ sessionCreated        â†’ ä¼šè¯åˆ›å»º
â”œâ”€â”€ sessionDestroyed      â†’ ä¼šè¯é”€æ¯
â”œâ”€â”€ attributeAdded        â†’ ä¼šè¯å±æ€§æ·»åŠ 
â”œâ”€â”€ attributeRemoved      â†’ ä¼šè¯å±æ€§åˆ é™¤
â””â”€â”€ attributeReplaced     â†’ ä¼šè¯å±æ€§ä¿®æ”¹

ğŸ“‹ è¯·æ±‚çº§äº‹ä»¶ (ServletRequest)
â”œâ”€â”€ requestInitialized    â†’ è¯·æ±‚å¼€å§‹
â”œâ”€â”€ requestDestroyed      â†’ è¯·æ±‚ç»“æŸ
â”œâ”€â”€ attributeAdded        â†’ è¯·æ±‚å±æ€§æ·»åŠ 
â”œâ”€â”€ attributeRemoved      â†’ è¯·æ±‚å±æ€§åˆ é™¤  
â””â”€â”€ attributeReplaced     â†’ è¯·æ±‚å±æ€§ä¿®æ”¹
```

### 4.3 äº‹ä»¶é©±åŠ¨çš„åä½œæ¨¡å¼


**ğŸ­ å®é™…åä½œæ¡ˆä¾‹ï¼šç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªç³»ç»Ÿ**

```java
// ç¬¬ä¸€æ­¥ï¼šå®šä¹‰äº‹ä»¶ç›‘å¬å™¨
public class UserBehaviorListener implements HttpSessionListener, 
                                           HttpSessionAttributeListener {
    
    // ç›‘å¬ç”¨æˆ·ç™»å½•
    @Override
    public void attributeAdded(HttpSessionBindingEvent event) {
        if ("currentUser".equals(event.getName())) {
            User user = (User) event.getValue();
            
            // é€šçŸ¥å…¶ä»–ç»„ä»¶ï¼šç”¨æˆ·å·²ç™»å½•
            ServletContext context = event.getSession().getServletContext();
            UserEventBroadcaster broadcaster = 
                (UserEventBroadcaster) context.getAttribute("eventBroadcaster");
            
            if (broadcaster != null) {
                broadcaster.userLoggedIn(user);
            }
        }
    }
    
    // ç›‘å¬ç”¨æˆ·é€€å‡º  
    @Override
    public void attributeRemoved(HttpSessionBindingEvent event) {
        if ("currentUser".equals(event.getName())) {
            User user = (User) event.getValue();
            
            // é€šçŸ¥å…¶ä»–ç»„ä»¶ï¼šç”¨æˆ·å·²é€€å‡º
            ServletContext context = event.getSession().getServletContext();
            UserEventBroadcaster broadcaster = 
                (UserEventBroadcaster) context.getAttribute("eventBroadcaster");
                
            if (broadcaster != null) {
                broadcaster.userLoggedOut(user);
            }
        }
    }
}

// ç¬¬äºŒæ­¥ï¼šFilteræ ¹æ®äº‹ä»¶åšå‡ºå“åº”
public class UserTrackingFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        
        // è·å–äº‹ä»¶å¹¿æ’­å™¨
        ServletContext context = httpRequest.getServletContext();
        UserEventBroadcaster broadcaster = 
            (UserEventBroadcaster) context.getAttribute("eventBroadcaster");
            
        if (broadcaster != null) {
            // è®°å½•ç”¨æˆ·è®¿é—®è¡Œä¸º
            String userId = getCurrentUserId(httpRequest);
            if (userId != null) {
                broadcaster.userAccessPage(userId, httpRequest.getRequestURI());
            }
        }
        
        chain.doFilter(request, response);
    }
    
    private String getCurrentUserId(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session != null) {
            User user = (User) session.getAttribute("currentUser");
            return user != null ? user.getId() : null;
        }
        return null;
    }
}
```

### 4.4 è‡ªå®šä¹‰äº‹ä»¶å¹¿æ’­å™¨


**ğŸª åˆ›å»ºè‡ªå·±çš„äº‹ä»¶é€šä¿¡æœºåˆ¶**ï¼š

```java
// è‡ªå®šä¹‰äº‹ä»¶å¹¿æ’­å™¨
public class UserEventBroadcaster {
    private List<UserEventHandler> handlers = new ArrayList<>();
    
    // æ³¨å†Œäº‹ä»¶å¤„ç†å™¨
    public void addHandler(UserEventHandler handler) {
        handlers.add(handler);
    }
    
    // å¹¿æ’­ç”¨æˆ·ç™»å½•äº‹ä»¶
    public void userLoggedIn(User user) {
        for (UserEventHandler handler : handlers) {
            try {
                handler.onUserLogin(user);
            } catch (Exception e) {
                // è®°å½•é”™è¯¯ï¼Œä½†ä¸å½±å“å…¶ä»–å¤„ç†å™¨
                System.err.println("å¤„ç†ç”¨æˆ·ç™»å½•äº‹ä»¶å¤±è´¥: " + e.getMessage());
            }
        }
    }
    
    // å¹¿æ’­ç”¨æˆ·è®¿é—®äº‹ä»¶
    public void userAccessPage(String userId, String pageUrl) {
        for (UserEventHandler handler : handlers) {
            try {
                handler.onUserAccess(userId, pageUrl);
            } catch (Exception e) {
                System.err.println("å¤„ç†ç”¨æˆ·è®¿é—®äº‹ä»¶å¤±è´¥: " + e.getMessage());
            }
        }
    }
}

// äº‹ä»¶å¤„ç†å™¨æ¥å£
interface UserEventHandler {
    void onUserLogin(User user);
    void onUserLogout(User user);
    void onUserAccess(String userId, String pageUrl);
}
```

---

## 5. â›“ï¸ è´£ä»»é“¾æ¨¡å¼åº”ç”¨


### 5.1 è´£ä»»é“¾æ¨¡å¼ç†è§£


**ğŸ­ æµæ°´çº¿ä½œä¸šçš„ç†å¿µ**ï¼š

```
å·¥å‚æµæ°´çº¿ï¼š                  Filterè´£ä»»é“¾ï¼š
åŸæ–™ â†’ å·¥åº1 â†’ å·¥åº2 â†’ æˆå“    è¯·æ±‚ â†’ Filter1 â†’ Filter2 â†’ Servlet

ç‰¹ç‚¹ï¼š
- æ¯ä¸ªå·¥åºä¸“æ³¨è‡ªå·±çš„ä»»åŠ¡
- å¯ä»¥éšæ—¶æ’å…¥æ–°å·¥åº
- æŸä¸ªå·¥åºå‡ºé—®é¢˜ä¸å½±å“å…¶ä»–
- é¡ºåºå¯ä»¥è°ƒæ•´
```

**ğŸ”— è´£ä»»é“¾çš„æ ¸å¿ƒæ€æƒ³**ï¼š
```
æ¯ä¸ªFilterå°±æ˜¯è´£ä»»é“¾ä¸­çš„ä¸€ä¸ªç¯èŠ‚ï¼š
- å¤„ç†è‡ªå·±è´Ÿè´£çš„ä»»åŠ¡
- å†³å®šæ˜¯å¦ä¼ é€’ç»™ä¸‹ä¸€ä¸ªç¯èŠ‚
- å¯ä»¥åœ¨ä¼ é€’å‰ååšé¢å¤–å¤„ç†
```

### 5.2 Filteré“¾çš„è´£ä»»åˆ†å·¥


**ğŸ“‹ å…¸å‹çš„Filterè´£ä»»é“¾é…ç½®**ï¼š

```
Webåº”ç”¨ä¸­çš„Filterè´£ä»»é“¾ï¼š

â‘ å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨ - EncodingFilter
â””â”€â”€ èŒè´£ï¼šç»Ÿä¸€è®¾ç½®è¯·æ±‚å“åº”ç¼–ç 
    
â‘¡ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨ - AuthenticationFilter  
â””â”€â”€ èŒè´£ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•

â‘¢æƒé™éªŒè¯è¿‡æ»¤å™¨ - AuthorizationFilter
â””â”€â”€ èŒè´£ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®

â‘£æ—¥å¿—è®°å½•è¿‡æ»¤å™¨ - LoggingFilter
â””â”€â”€ èŒè´£ï¼šè®°å½•è¯·æ±‚è®¿é—®æ—¥å¿—

â‘¤ç¼“å­˜æ§åˆ¶è¿‡æ»¤å™¨ - CacheFilter
â””â”€â”€ èŒè´£ï¼šè®¾ç½®HTTPç¼“å­˜å¤´

â‘¥æœ€ç»ˆå¤„ç† - ç›®æ ‡Servlet
â””â”€â”€ èŒè´£ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†
```

### 5.3 è´£ä»»é“¾çš„å®é™…å®ç°


**ğŸ› ï¸ å®ç°ä¸€ä¸ªå®Œæ•´çš„è´£ä»»é“¾**ï¼š

```java
// åŸºç¡€FilteræŠ½è±¡ç±»
public abstract class BaseFilter implements Filter {
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        System.out.println(getFilterName() + " åˆå§‹åŒ–å®Œæˆ");
    }
    
    @Override
    public void destroy() {
        System.out.println(getFilterName() + " é”€æ¯å®Œæˆ");
    }
    
    // å­ç±»å®ç°å…·ä½“çš„è¿‡æ»¤é€»è¾‘
    protected abstract void doFilter(HttpServletRequest request, 
                                   HttpServletResponse response, 
                                   FilterChain chain) 
                                   throws IOException, ServletException;
    
    // è·å–è¿‡æ»¤å™¨åç§°
    protected abstract String getFilterName();
    
    @Override
    public final void doFilter(ServletRequest request, ServletResponse response, 
                              FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        long startTime = System.currentTimeMillis();
        
        try {
            doFilter(httpRequest, httpResponse, chain);
        } finally {
            long endTime = System.currentTimeMillis();
            System.out.println(getFilterName() + " å¤„ç†è€—æ—¶: " + (endTime - startTime) + "ms");
        }
    }
}

// å…·ä½“çš„Filterå®ç°
public class EncodingFilter extends BaseFilter {
    
    @Override
    protected void doFilter(HttpServletRequest request, 
                           HttpServletResponse response, 
                           FilterChain chain) throws IOException, ServletException {
        
        // è®¾ç½®ç¼–ç 
        request.setCharacterEncoding("UTF-8");
        response.setCharacterEncoding("UTF-8");
        
        System.out.println("ç¼–ç è®¾ç½®å®Œæˆï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªFilter");
        
        // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªç¯èŠ‚
        chain.doFilter(request, response);
        
        System.out.println("ç¼–ç Filterå“åº”å¤„ç†å®Œæˆ");
    }
    
    @Override
    protected String getFilterName() {
        return "EncodingFilter";
    }
}

public class AuthFilter extends BaseFilter {
    
    @Override  
    protected void doFilter(HttpServletRequest request, 
                           HttpServletResponse response, 
                           FilterChain chain) throws IOException, ServletException {
        
        HttpSession session = request.getSession(false);
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        if (session == null || session.getAttribute("user") == null) {
            System.out.println("ç”¨æˆ·æœªç™»å½•ï¼Œæ‹’ç»è®¿é—®");
            response.sendRedirect("/login.jsp");
            return; // ä¸ç»§ç»­ä¼ é€’
        }
        
        System.out.println("ç”¨æˆ·å·²ç™»å½•ï¼Œå…è®¸è®¿é—®");
        
        // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªç¯èŠ‚
        chain.doFilter(request, response);
        
        System.out.println("æƒé™Filterå“åº”å¤„ç†å®Œæˆ");
    }
    
    @Override
    protected String getFilterName() {
        return "AuthFilter";
    }
}
```

### 5.4 è´£ä»»é“¾çš„åŠ¨æ€é…ç½®


**âš™ï¸ é€šè¿‡é…ç½®çµæ´»æ§åˆ¶è´£ä»»é“¾**ï¼š

```java
// è´£ä»»é“¾ç®¡ç†å™¨
public class FilterChainManager {
    private ServletContext servletContext;
    
    // åœ¨åº”ç”¨å¯åŠ¨æ—¶é…ç½®è´£ä»»é“¾
    public void configureFilterChain(ServletContextEvent event) {
        this.servletContext = event.getServletContext();
        
        // è¯»å–é…ç½®å†³å®šå¯ç”¨å“ªäº›Filter
        String filterConfig = servletContext.getInitParameter("filter.chain.config");
        
        if ("production".equals(filterConfig)) {
            // ç”Ÿäº§ç¯å¢ƒï¼šå¯ç”¨æ‰€æœ‰å®‰å…¨ç›¸å…³Filter
            enableSecurityFilters();
        } else if ("development".equals(filterConfig)) {
            // å¼€å‘ç¯å¢ƒï¼šå¯ç”¨è°ƒè¯•ç›¸å…³Filter
            enableDebugFilters();
        }
    }
    
    private void enableSecurityFilters() {
        System.out.println("å¯ç”¨ç”Ÿäº§ç¯å¢ƒFilteré“¾ï¼š");
        System.out.println("- EncodingFilter");
        System.out.println("- SecurityFilter");  
        System.out.println("- AuthFilter");
        System.out.println("- LoggingFilter");
    }
    
    private void enableDebugFilters() {
        System.out.println("å¯ç”¨å¼€å‘ç¯å¢ƒFilteré“¾ï¼š");
        System.out.println("- EncodingFilter");
        System.out.println("- DebugFilter");
        System.out.println("- LoggingFilter");
    }
}
```

---

## 6. ğŸ‘ï¸ è§‚å¯Ÿè€…æ¨¡å¼é›†æˆ


### 6.1 è§‚å¯Ÿè€…æ¨¡å¼åŸºæœ¬ç†è§£


**ğŸ“º å°±åƒè®¢é˜…ç”µè§†èŠ‚ç›®**ï¼š

```
ç”µè§†å°å¹¿æ’­æ¨¡å¼ï¼š              è§‚å¯Ÿè€…æ¨¡å¼ï¼š
ç”µè§†å°æ’­æ”¾èŠ‚ç›® â†’ å¹¿æ’­ä¿¡å·      äº‹ä»¶å‘ç”Ÿ â†’ é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…
è§‚ä¼—æ”¶çœ‹èŠ‚ç›® â†’ å„è‡ªååº”        ç›‘å¬å™¨æ¥æ”¶ â†’ å„è‡ªå¤„ç†

å…³é”®ç‰¹ç‚¹ï¼š
- ç”µè§†å°ä¸å…³å¿ƒè°åœ¨çœ‹
- è§‚ä¼—å¯ä»¥è‡ªç”±é€‰æ‹©çœ‹æˆ–ä¸çœ‹
- æ–°è§‚ä¼—å¯ä»¥éšæ—¶åŠ å…¥
- è§‚ä¼—ç¦»å¼€ä¸å½±å“æ’­æ”¾
```

**ğŸ¯ è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜åŠ¿**ï¼š
```
æ¾è€¦åˆï¼šè¢«è§‚å¯Ÿè€…ä¸ä¾èµ–å…·ä½“è§‚å¯Ÿè€…
å¯æ‰©å±•ï¼šéšæ—¶æ·»åŠ æ–°çš„è§‚å¯Ÿè€…
çµæ´»æ€§ï¼šè§‚å¯Ÿè€…å¯ä»¥é€‰æ‹©æ€§å“åº”äº‹ä»¶
```

### 6.2 Webå®¹å™¨ä¸­çš„è§‚å¯Ÿè€…å®ç°


**ğŸ‘€ Listenerå°±æ˜¯æ ‡å‡†çš„è§‚å¯Ÿè€…**ï¼š

```java
// ServletContextä½œä¸ºè¢«è§‚å¯Ÿè€…
// å¤šä¸ªListenerä½œä¸ºè§‚å¯Ÿè€…

// è§‚å¯Ÿè€…1ï¼šåº”ç”¨çŠ¶æ€ç›‘æ§
public class AppStatusListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent event) {
        System.out.println("[çŠ¶æ€ç›‘æ§] åº”ç”¨å¯åŠ¨ï¼Œå¼€å§‹ç›‘æ§ç³»ç»ŸçŠ¶æ€");
        
        // å¯åŠ¨çŠ¶æ€ç›‘æ§çº¿ç¨‹
        ServletContext context = event.getServletContext();
        context.setAttribute("monitoring.enabled", true);
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent event) {
        System.out.println("[çŠ¶æ€ç›‘æ§] åº”ç”¨å…³é—­ï¼Œåœæ­¢ç›‘æ§");
    }
}

// è§‚å¯Ÿè€…2ï¼šç»Ÿè®¡ä¿¡æ¯æ”¶é›†
public class StatisticsListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent event) {
        System.out.println("[ç»Ÿè®¡æœåŠ¡] å¼€å§‹æ”¶é›†åº”ç”¨ç»Ÿè®¡ä¿¡æ¯");
        
        ServletContext context = event.getServletContext();
        context.setAttribute("app.startTime", new Date());
        context.setAttribute("app.requestCount", new AtomicLong(0));
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent event) {
        System.out.println("[ç»Ÿè®¡æœåŠ¡] ä¿å­˜ç»Ÿè®¡ä¿¡æ¯å¹¶é€€å‡º");
        
        ServletContext context = event.getServletContext();
        Date startTime = (Date) context.getAttribute("app.startTime");
        AtomicLong requestCount = (AtomicLong) context.getAttribute("app.requestCount");
        
        long runTime = System.currentTimeMillis() - startTime.getTime();
        System.out.println("åº”ç”¨è¿è¡Œæ—¶é—´: " + runTime + "ms");
        System.out.println("æ€»è¯·æ±‚æ•°é‡: " + requestCount.get());
    }
}

// è§‚å¯Ÿè€…3ï¼šç¼“å­˜ç®¡ç†
public class CacheManagerListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent event) {
        System.out.println("[ç¼“å­˜ç®¡ç†] åˆå§‹åŒ–ç¼“å­˜ç³»ç»Ÿ");
        
        // åˆ›å»ºç¼“å­˜ç®¡ç†å™¨
        Map<String, Object> cache = new ConcurrentHashMap<>();
        event.getServletContext().setAttribute("app.cache", cache);
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent event) {
        System.out.println("[ç¼“å­˜ç®¡ç†] æ¸…ç†ç¼“å­˜èµ„æº");
        
        @SuppressWarnings("unchecked")
        Map<String, Object> cache = (Map<String, Object>) 
            event.getServletContext().getAttribute("app.cache");
        
        if (cache != null) {
            cache.clear();
        }
    }
}
```

### 6.3 è‡ªå®šä¹‰è§‚å¯Ÿè€…æ¨¡å¼å®ç°


**ğŸ¨ åˆ›å»ºä¸šåŠ¡å±‚é¢çš„è§‚å¯Ÿè€…æ¨¡å¼**ï¼š

```java
// è‡ªå®šä¹‰äº‹ä»¶ç±»å‹
public class UserEvent {
    private String eventType;
    private User user;
    private Date timestamp;
    private String description;
    
    public UserEvent(String eventType, User user, String description) {
        this.eventType = eventType;
        this.user = user;
        this.description = description;
        this.timestamp = new Date();
    }
    
    // getters...
}

// ç”¨æˆ·äº‹ä»¶è§‚å¯Ÿè€…æ¥å£
public interface UserEventObserver {
    void onUserEvent(UserEvent event);
}

// ç”¨æˆ·äº‹ä»¶ä¸»é¢˜ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰
public class UserEventSubject {
    private List<UserEventObserver> observers = new ArrayList<>();
    
    // æ·»åŠ è§‚å¯Ÿè€…
    public void addObserver(UserEventObserver observer) {
        observers.add(observer);
    }
    
    // ç§»é™¤è§‚å¯Ÿè€…  
    public void removeObserver(UserEventObserver observer) {
        observers.remove(observer);
    }
    
    // é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…
    public void notifyObservers(UserEvent event) {
        for (UserEventObserver observer : observers) {
            try {
                observer.onUserEvent(event);
            } catch (Exception e) {
                System.err.println("é€šçŸ¥è§‚å¯Ÿè€…å¤±è´¥: " + e.getMessage());
            }
        }
    }
    
    // è§¦å‘ç”¨æˆ·ç™»å½•äº‹ä»¶
    public void userLoggedIn(User user) {
        UserEvent event = new UserEvent("LOGIN", user, "ç”¨æˆ·ç™»å½•æˆåŠŸ");
        notifyObservers(event);
    }
    
    // è§¦å‘ç”¨æˆ·é€€å‡ºäº‹ä»¶
    public void userLoggedOut(User user) {
        UserEvent event = new UserEvent("LOGOUT", user, "ç”¨æˆ·é€€å‡ºç³»ç»Ÿ");
        notifyObservers(event);
    }
}

// å…·ä½“è§‚å¯Ÿè€…å®ç°
public class UserActivityLogger implements UserEventObserver {
    
    @Override
    public void onUserEvent(UserEvent event) {
        System.out.println("[æ´»åŠ¨æ—¥å¿—] " + event.getTimestamp() + 
                          " - " + event.getUser().getUsername() + 
                          " " + event.getDescription());
    }
}

public class SecurityMonitor implements UserEventObserver {
    
    @Override
    public void onUserEvent(UserEvent event) {
        if ("LOGIN".equals(event.getEventType())) {
            // æ£€æŸ¥å¼‚å¸¸ç™»å½•
            checkSuspiciousLogin(event.getUser());
        }
    }
    
    private void checkSuspiciousLogin(User user) {
        System.out.println("[å®‰å…¨ç›‘æ§] æ£€æŸ¥ç”¨æˆ·ç™»å½•å®‰å…¨æ€§: " + user.getUsername());
    }
}
```

### 6.4 è§‚å¯Ÿè€…ä¸Filterçš„åä½œ


**ğŸ¤ è§‚å¯Ÿè€…é€šçŸ¥Filteråšå‡ºå“åº”**ï¼š

```java
// åœ¨Filterä¸­ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼
public class UserActivityFilter implements Filter {
    private UserEventSubject eventSubject;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // ä»ServletContextè·å–äº‹ä»¶ä¸»é¢˜
        ServletContext context = filterConfig.getServletContext();
        eventSubject = (UserEventSubject) context.getAttribute("userEventSubject");
        
        if (eventSubject == null) {
            eventSubject = new UserEventSubject();
            context.setAttribute("userEventSubject", eventSubject);
            
            // æ³¨å†Œè§‚å¯Ÿè€…
            eventSubject.addObserver(new UserActivityLogger());
            eventSubject.addObserver(new SecurityMonitor());
        }
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpSession session = httpRequest.getSession(false);
        
        // æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ç”¨æˆ·ç™»å½•
        if (session != null) {
            User user = (User) session.getAttribute("currentUser");
            if (user != null) {
                // è§¦å‘ç”¨æˆ·æ´»åŠ¨äº‹ä»¶
                UserEvent event = new UserEvent("ACTIVITY", user, 
                    "è®¿é—®é¡µé¢: " + httpRequest.getRequestURI());
                eventSubject.notifyObservers(event);
            }
        }
        
        chain.doFilter(request, response);
    }
}
```

---

## 7. ğŸ¯ è®¾è®¡æ¨¡å¼æœ€ä½³å®è·µ


### 7.1 æ¨¡å¼é€‰æ‹©æŒ‡å—


**ğŸ“‹ ä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆæ¨¡å¼**ï¼š

| åœºæ™¯æè¿° | **æ¨èæ¨¡å¼** | **åŸå› ** | **å®ç°æ–¹å¼** |
|---------|-------------|---------|-------------|
| **è¯·æ±‚é¢„å¤„ç†** | `è´£ä»»é“¾æ¨¡å¼` | `é¡ºåºå¤„ç†ï¼ŒèŒè´£åˆ†ç¦»` | `Filteré“¾` |
| **çŠ¶æ€ç›‘æ§** | `è§‚å¯Ÿè€…æ¨¡å¼` | `æ¾è€¦åˆé€šçŸ¥æœºåˆ¶` | `Listenerç›‘å¬` |
| **æƒé™æ£€æŸ¥** | `è´£ä»»é“¾+è§‚å¯Ÿè€…` | `çµæ´»çš„æƒé™ç­–ç•¥` | `Filter+Listeneråä½œ` |
| **æ—¥å¿—è®°å½•** | `è§‚å¯Ÿè€…æ¨¡å¼` | `ç»Ÿä¸€çš„äº‹ä»¶å“åº”` | `å¤šListenerç›‘å¬` |
| **ç¼“å­˜ç®¡ç†** | `å•ä¾‹+è§‚å¯Ÿè€…` | `å…¨å±€ç¼“å­˜+äº‹ä»¶æ¸…ç†` | `ServletContext+Listener` |

### 7.2 åä½œæ¨¡å¼æœ€ä½³å®è·µ


**ğŸŒŸ æ¨èçš„åä½œæ¶æ„**ï¼š

```
ä¼ä¸šçº§Webåº”ç”¨åä½œæ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å®¢æˆ·ç«¯è¯·æ±‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Filterè´£ä»»é“¾å¤„ç†            â”‚
â”‚  ç¼–ç â†’å®‰å…¨â†’è®¤è¯â†’æˆæƒâ†’æ—¥å¿—â†’ç¼“å­˜       â”‚  â† è´£ä»»é“¾æ¨¡å¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Servletå¤„ç†              â”‚
â”‚          æ ¸å¿ƒä¸šåŠ¡é€»è¾‘               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Listeneräº‹ä»¶å¤„ç†            â”‚
â”‚   çŠ¶æ€ç›‘æ§â†’ç»Ÿè®¡æ”¶é›†â†’æ—¥å¿—è®°å½•         â”‚  â† è§‚å¯Ÿè€…æ¨¡å¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 ä»£ç ç»„ç»‡æœ€ä½³å®è·µ


**ğŸ“ æ¨èçš„åŒ…ç»“æ„**ï¼š

```
é¡¹ç›®åŒ…ç»“æ„ï¼š
src/main/java/
â”œâ”€â”€ com.example.web/
â”‚   â”œâ”€â”€ filter/              â† FilteråŒ…
â”‚   â”‚   â”œâ”€â”€ base/            â† åŸºç¡€Filterç±»
â”‚   â”‚   â”œâ”€â”€ auth/            â† è®¤è¯ç›¸å…³Filter  
â”‚   â”‚   â”œâ”€â”€ security/        â† å®‰å…¨ç›¸å…³Filter
â”‚   â”‚   â””â”€â”€ util/            â† Filterå·¥å…·ç±»
â”‚   â”œâ”€â”€ listener/            â† ListeneråŒ…  
â”‚   â”‚   â”œâ”€â”€ context/         â† Contextç›‘å¬å™¨
â”‚   â”‚   â”œâ”€â”€ session/         â† Sessionç›‘å¬å™¨
â”‚   â”‚   â””â”€â”€ request/         â† Requestç›‘å¬å™¨
â”‚   â”œâ”€â”€ event/               â† äº‹ä»¶ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ UserEvent.java   â† äº‹ä»¶ç±»
â”‚   â”‚   â””â”€â”€ EventBroadcaster.java â† äº‹ä»¶å¹¿æ’­å™¨
â”‚   â””â”€â”€ pattern/             â† è®¾è®¡æ¨¡å¼å®ç°
â”‚       â”œâ”€â”€ chain/           â† è´£ä»»é“¾æ¨¡å¼
â”‚       â””â”€â”€ observer/        â† è§‚å¯Ÿè€…æ¨¡å¼
```

### 7.4 é…ç½®ç®¡ç†æœ€ä½³å®è·µ


**âš™ï¸ web.xmlé…ç½®ç¤ºä¾‹**ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="3.1">
    
    <!-- åº”ç”¨åˆå§‹åŒ–å‚æ•° -->
    <context-param>
        <param-name>app.profile</param-name>
        <param-value>production</param-value>
    </context-param>
    
    <!-- Listeneré…ç½®ï¼ˆæŒ‰å¯åŠ¨é¡ºåºï¼‰ -->
    <listener>
        <listener-class>com.example.web.listener.context.AppInitListener</listener-class>
    </listener>
    <listener>
        <listener-class>com.example.web.listener.context.CacheManagerListener</listener-class>
    </listener>
    <listener>
        <listener-class>com.example.web.listener.session.UserSessionListener</listener-class>
    </listener>
    
    <!-- Filteré…ç½®ï¼ˆæŒ‰æ‰§è¡Œé¡ºåºï¼‰ -->
    <filter>
        <filter-name>EncodingFilter</filter-name>
        <filter-class>com.example.web.filter.util.EncodingFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>EncodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
    
    <filter>
        <filter-name>SecurityFilter</filter-name>
        <filter-class>com.example.web.filter.security.SecurityFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>SecurityFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
    
    <filter>
        <filter-name>AuthFilter</filter-name>
        <filter-class>com.example.web.filter.auth.AuthFilter</filter-class>
        <init-param>
            <param-name>excludeUrls</param-name>
            <param-value>/login.jsp,/register.jsp,/public/*</param-value>
        </init-param>
    </filter>
    <filter-mapping>
        <filter-name>AuthFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
    
</web-app>
```

### 7.5 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼š

```
æ€§èƒ½ä¼˜åŒ–æ¸…å•ï¼š

ğŸ”¸ Filterä¼˜åŒ–
- å‡å°‘ä¸å¿…è¦çš„å­—ç¬¦ä¸²æ“ä½œ
- åˆç†ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è®¡ç®—
- åŠæ—¶é‡Šæ”¾èµ„æºï¼ˆæ•°æ®åº“è¿æ¥ç­‰ï¼‰

ğŸ”¸ Listenerä¼˜åŒ–  
- é¿å…åœ¨Listenerä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- ä½¿ç”¨å¼‚æ­¥å¤„ç†é•¿æ—¶é—´ä»»åŠ¡
- åˆç†è®¾ç½®ç›‘å¬å™¨æ‰§è¡Œé¡ºåº

ğŸ”¸ æ•°æ®å…±äº«ä¼˜åŒ–
- ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„
- é¿å…åœ¨ServletContextä¸­å­˜å‚¨å¤§é‡æ•°æ®
- å®šæœŸæ¸…ç†è¿‡æœŸçš„Sessionæ•°æ®

ğŸ”¸ äº‹ä»¶å¤„ç†ä¼˜åŒ–
- äº‹ä»¶å¤„ç†å™¨è¦å¿«é€Ÿè¿”å›
- å¼‚å¸¸è¦å¦¥å–„å¤„ç†ï¼Œä¸èƒ½å½±å“å…¶ä»–å¤„ç†å™¨
- è€ƒè™‘ä½¿ç”¨å¼‚æ­¥äº‹ä»¶å¤„ç†
```

---

## 8. ğŸ“ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åä½œæœºåˆ¶ï¼šFilterè´Ÿè´£æ‹¦æˆªå¤„ç†ï¼ŒListenerè´Ÿè´£çŠ¶æ€ç›‘å¬
ğŸ”¸ æ‰§è¡Œæ—¶åºï¼šListenerå…ˆå¯åŠ¨ï¼ŒFilteråæ‰§è¡Œï¼Œé”€æ¯æ—¶ç›¸å
ğŸ”¸ æ•°æ®å…±äº«ï¼šé€šè¿‡ServletContextã€Sessionã€Requestä¼ é€’æ•°æ®
ğŸ”¸ äº‹ä»¶é€šä¿¡ï¼šåŸºäºå®¹å™¨äº‹ä»¶çš„æ¾è€¦åˆé€šä¿¡æœºåˆ¶
ğŸ”¸ è´£ä»»é“¾æ¨¡å¼ï¼šFilteré“¾å®ç°é¡ºåºå¤„ç†å’ŒèŒè´£åˆ†ç¦»
ğŸ”¸ è§‚å¯Ÿè€…æ¨¡å¼ï¼šListenerå®ç°äº‹ä»¶é©±åŠ¨çš„å“åº”æœºåˆ¶
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ åä½œçš„æœ¬è´¨ç†è§£**ï¼š
```
ç±»æ¯”ç†è§£ï¼š
Filter = ä¿å®‰ï¼Œè´Ÿè´£æ£€æŸ¥å’Œæ§åˆ¶
Listener = ç®¡å®¶ï¼Œè´Ÿè´£ç›‘æ§å’ŒæœåŠ¡
åä½œ = ä¿å®‰æ ¹æ®ç®¡å®¶æä¾›çš„ä¿¡æ¯åšæ›´å¥½çš„å†³ç­–

æ ¸å¿ƒä»·å€¼ï¼š
å•ç‹¬ä½¿ç”¨æœ‰å±€é™ï¼Œåä½œä½¿ç”¨å‘æŒ¥æœ€å¤§æ•ˆèƒ½
```

**ğŸ”¹ æ—¶åºçš„é‡è¦æ€§**ï¼š
```
è®°å¿†è¦ç‚¹ï¼š
å¯åŠ¨ï¼šListener â†’ Filter â†’ Servlet
è¯·æ±‚ï¼šListeneræ„ŸçŸ¥ â†’ Filterå¤„ç† â†’ Servletæ‰§è¡Œ
å“åº”ï¼šServletè¿”å› â†’ Filterå¤„ç† â†’ Listeneræ¸…ç†
å…³é—­ï¼šFilteré”€æ¯ â†’ Listeneré”€æ¯
```

**ğŸ”¹ æ•°æ®å…±äº«çš„å±‚æ¬¡**ï¼š
```
å…±äº«èŒƒå›´ï¼š
ServletContextï¼šå…¨å±€å…±äº«ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®
HttpSessionï¼šä¼šè¯å…±äº«ï¼Œå•ä¸ªç”¨æˆ·çš„å¤šæ¬¡è¯·æ±‚
HttpServletRequestï¼šè¯·æ±‚å…±äº«ï¼Œå•æ¬¡è¯·æ±‚å†…éƒ¨

é€‰æ‹©åŸåˆ™ï¼š
æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸå†³å®šå­˜å‚¨ä½ç½®
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
```
ä¼ä¸šåº”ç”¨åœºæ™¯ï¼š
- ç”¨æˆ·è®¤è¯æˆæƒç³»ç»Ÿ
- ç³»ç»Ÿç›‘æ§å’Œç»Ÿè®¡
- æ—¥å¿—è®°å½•å’Œå®¡è®¡  
- ç¼“å­˜ç®¡ç†å’Œä¼˜åŒ–
- å®‰å…¨é˜²æŠ¤å’Œé™æµ
```

**ğŸ› ï¸ å¼€å‘å®è·µæŒ‡å¯¼**ï¼š
```
è®¾è®¡åŸåˆ™ï¼š
- å•ä¸€èŒè´£ï¼šæ¯ä¸ªç»„ä»¶ä¸“æ³¨è‡ªå·±çš„ä»»åŠ¡
- æ¾è€¦åˆï¼šé€šè¿‡äº‹ä»¶å’Œæ•°æ®å…±äº«åä½œ
- å¯æ‰©å±•ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ æ–°çš„å¤„ç†é€»è¾‘
- é«˜æ€§èƒ½ï¼šé¿å…ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—

å®æ–½å»ºè®®ï¼š
- åˆç†è§„åˆ’Filteræ‰§è¡Œé¡ºåº
- å–„ç”¨Listenerç›‘å¬å…³é”®äº‹ä»¶
- å»ºç«‹ç»Ÿä¸€çš„äº‹ä»¶é€šä¿¡æœºåˆ¶
- åˆ¶å®šæ¸…æ™°çš„æ•°æ®å…±äº«è§„èŒƒ
```

### 8.4 å­¦ä¹ è¦ç‚¹å¼ºåŒ–


**ğŸ§  è®°å¿†æŠ€å·§**ï¼š
```
åä½œæ¨¡å¼è®°å¿†å£è¯€ï¼š
"ç›‘å¬å…ˆè¡Œæ¢è·¯å†µï¼Œè¿‡æ»¤ä¸­é—´æŠŠé—¨è£…ï¼Œ
è´£ä»»é“¾ä¸Šåˆ†å·¥å¿™ï¼Œè§‚å¯Ÿæ¨¡å¼å¹¿æ’­åœº"

æ—¶åºå…³ç³»è®°å¿†ï¼š
"å¯åŠ¨æ—¶ç›‘å¬é¢†å…ˆé”‹ï¼Œè¿‡æ»¤å…¶åç´§è·Ÿä»ï¼Œ
è¯·æ±‚æ¥æ—¶ç›‘å¬çŸ¥ï¼Œè¿‡æ»¤å¤„ç†å†ä¼ é€ï¼Œ
å“åº”å›æ—¶è¿‡æ»¤å…ˆï¼Œç›‘å¬æœ€ååšæ¸…æ´"
```

**âœ… æŒæ¡åº¦æ£€æŸ¥æ¸…å•**ï¼š
- [ ] èƒ½è§£é‡ŠFilterä¸Listenerçš„åä½œåŸç†
- [ ] èƒ½æè¿°å®Œæ•´çš„è¯·æ±‚å¤„ç†æ—¶åº
- [ ] èƒ½è®¾è®¡æ•°æ®å…±äº«æ–¹æ¡ˆ
- [ ] èƒ½å®ç°äº‹ä»¶é©±åŠ¨çš„é€šä¿¡æœºåˆ¶  
- [ ] èƒ½åº”ç”¨è´£ä»»é“¾å’Œè§‚å¯Ÿè€…æ¨¡å¼
- [ ] èƒ½è¿›è¡Œæ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ

**æ ¸å¿ƒè®°å¿†**ï¼š
Filterä¸Listeneråä½œæ˜¯JavaWebçš„é«˜çº§ç‰¹æ€§ï¼Œé€šè¿‡åˆç†çš„è®¾è®¡æ¨¡å¼åº”ç”¨ï¼Œå¯ä»¥æ„å»ºå‡ºæ¾è€¦åˆã€é«˜æ‰©å±•ã€æ˜“ç»´æŠ¤çš„Webåº”ç”¨æ¶æ„ã€‚å…³é”®æ˜¯ç†è§£å„è‡ªèŒè´£ï¼Œå–„ç”¨æ•°æ®å…±äº«å’Œäº‹ä»¶é€šä¿¡ï¼Œè®©å®ƒä»¬å‘æŒ¥ååŒæ•ˆåº”ã€‚