---
title: 1ã€Filter-é…ç½®æ–¹å¼å®Œæ•´æŒ‡å—
---
## ğŸ“š ç›®å½•

1. [è¿‡æ»¤å™¨é…ç½®æ ¸å¿ƒæ¦‚å¿µ](#1-è¿‡æ»¤å™¨é…ç½®æ ¸å¿ƒæ¦‚å¿µ)
2. [ä¼ ç»Ÿweb.xmlé…ç½®è¯¦è§£](#2-ä¼ ç»Ÿwebxmlé…ç½®è¯¦è§£)
3. [æ³¨è§£é…ç½®æ·±å…¥ç†è§£](#3-æ³¨è§£é…ç½®æ·±å…¥ç†è§£)
4. [åŠ¨æ€æ³¨å†Œæœºåˆ¶è¯¦è§£](#4-åŠ¨æ€æ³¨å†Œæœºåˆ¶è¯¦è§£)
5. [Spring Bootè‡ªåŠ¨é…ç½®](#5-Spring-Bootè‡ªåŠ¨é…ç½®)
6. [é…ç½®å‚æ•°ä¼ é€’ä¸ç®¡ç†](#6-é…ç½®å‚æ•°ä¼ é€’ä¸ç®¡ç†)
7. [ç¯å¢ƒå˜é‡é›†æˆå®è·µ](#7-ç¯å¢ƒå˜é‡é›†æˆå®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¿‡æ»¤å™¨é…ç½®æ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨é…ç½®


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä¸€ä¸‹æœºåœºå®‰æ£€ï¼Œæ¯ä¸ªä¹˜å®¢éƒ½å¿…é¡»é€šè¿‡å®‰æ£€æ‰èƒ½ç™»æœºã€‚è¿‡æ»¤å™¨å°±åƒå®‰æ£€è®¾å¤‡ï¼Œè€Œé…ç½®å°±æ˜¯å‘Šè¯‰ç³»ç»Ÿ"åœ¨å“ªé‡Œæ”¾å®‰æ£€è®¾å¤‡ï¼Œæ£€æŸ¥å“ªäº›ä¹˜å®¢ï¼Œç”¨ä»€ä¹ˆæ ‡å‡†æ£€æŸ¥"ã€‚

```
Webè¯·æ±‚å¤„ç†æµç¨‹ï¼š

å®¢æˆ·ç«¯è¯·æ±‚ â†’ è¿‡æ»¤å™¨1 â†’ è¿‡æ»¤å™¨2 â†’ Servlet â†’ å“åº”
     â†‘          â†“        â†“        â†“
   é…ç½®å†³å®š   é…ç½®å†³å®š  é…ç½®å†³å®š  é…ç½®å†³å®š
   æ˜¯å¦æ‹¦æˆª   æ‰§è¡Œé¡ºåº  å¤„ç†é€»è¾‘  æ˜¯å¦æ”¾è¡Œ
```

> **ğŸ’¡ é…ç½®çš„æœ¬è´¨**ï¼šé…ç½®å°±æ˜¯å‘Šè¯‰Webå®¹å™¨"ä»€ä¹ˆæ—¶å€™ç”¨è¿‡æ»¤å™¨ï¼Œæ€ä¹ˆç”¨è¿‡æ»¤å™¨"

### 1.2 è¿‡æ»¤å™¨é…ç½®çš„å››ç§ä¸»æµæ–¹å¼


**ğŸ“‹ é…ç½®æ–¹å¼å¯¹æ¯”æ€»è§ˆ**

| **é…ç½®æ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **æ¨èåº¦** |
|-------------|-------------|---------|---------|-----------|
| **web.xml** | `ä¼ ç»Ÿé¡¹ç›®ã€ç²¾ç¡®æ§åˆ¶` | `é…ç½®é›†ä¸­ã€çµæ´»` | `XMLå†—é•¿ã€éƒ¨ç½²æ—¶é…ç½®` | â­â­â­ |
| **@WebFilter** | `ç®€å•é¡¹ç›®ã€å¿«é€Ÿå¼€å‘` | `ç®€æ´ã€å°±è¿‘é…ç½®` | `åŠŸèƒ½å—é™ã€éš¾ä»¥åŠ¨æ€è°ƒæ•´` | â­â­â­â­ |
| **åŠ¨æ€æ³¨å†Œ** | `å¤æ‚ä¸šåŠ¡ã€è¿è¡Œæ—¶é…ç½®` | `çµæ´»ã€å¯ç¼–ç¨‹` | `ä»£ç å¤æ‚ã€è°ƒè¯•å›°éš¾` | â­â­â­â­â­ |
| **Spring Boot** | `å¾®æœåŠ¡ã€ç°ä»£åº”ç”¨` | `è‡ªåŠ¨åŒ–ã€é›†æˆåº¦é«˜` | `æ¡†æ¶ä¾èµ–ã€å­¦ä¹ æˆæœ¬` | â­â­â­â­â­ |

### 1.3 é…ç½®é€‰æ‹©å†³ç­–æ ‘


```
è¿‡æ»¤å™¨é…ç½®æ–¹å¼é€‰æ‹©æŒ‡å—ï¼š

æ˜¯å¦ä½¿ç”¨Spring Boot?
â”œâ”€â”€ æ˜¯ â”€â”€â†’ ä¼˜å…ˆé€‰æ‹©Spring Booté…ç½®
â””â”€â”€ å¦
    â””â”€â”€ é¡¹ç›®å¤æ‚åº¦å¦‚ä½•?
        â”œâ”€â”€ ç®€å• â”€â”€â†’ ä½¿ç”¨@WebFilteræ³¨è§£
        â””â”€â”€ å¤æ‚
            â””â”€â”€ éœ€è¦åŠ¨æ€é…ç½®å—?
                â”œâ”€â”€ æ˜¯ â”€â”€â†’ ä½¿ç”¨åŠ¨æ€æ³¨å†Œ
                â””â”€â”€ å¦ â”€â”€â†’ ä½¿ç”¨web.xmlé…ç½®
```

---

## 2. ğŸ“„ ä¼ ç»Ÿweb.xmlé…ç½®è¯¦è§£


### 2.1 web.xmlé…ç½®åŸºç¡€è¯­æ³•


**ğŸ”¸ åŸºæœ¬é…ç½®ç»“æ„**

ä¼ ç»Ÿçš„web.xmlé…ç½®å°±åƒå¡«å†™ä¸€å¼ è¡¨æ ¼ï¼Œéœ€è¦å‘Šè¯‰å®¹å™¨ä¸‰ä»¶äº‹ï¼š
1. **è¿‡æ»¤å™¨æ˜¯ä»€ä¹ˆ**ï¼ˆå®šä¹‰ï¼‰
2. **è¿‡æ»¤å™¨æ€ä¹ˆç”¨**ï¼ˆæ˜ å°„ï¼‰  
3. **è¿‡æ»¤å™¨ä»€ä¹ˆæ—¶å€™ç”¨**ï¼ˆURLæ¨¡å¼ï¼‰

```xml
<!-- web.xmlé…ç½®ç¤ºä¾‹ -->
<web-app>
    <!-- ç¬¬1æ­¥ï¼šå®šä¹‰è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>encodingFilter</filter-name>
        <filter-class>com.example.EncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>UTF-8</param-value>
        </init-param>
    </filter>
    
    <!-- ç¬¬2æ­¥ï¼šé…ç½®è¿‡æ»¤å™¨æ˜ å°„ -->
    <filter-mapping>
        <filter-name>encodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
        <dispatcher>REQUEST</dispatcher>
    </filter-mapping>
</web-app>
```

**ğŸ” é…ç½®å…ƒç´ è¯¦è§£**

```
web.xmlè¿‡æ»¤å™¨é…ç½®è¦ç´ è§£æï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    <filter>                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  filter-name    â”‚  filter-class   â”‚   init-param    â”‚ â”‚
â”‚ â”‚   (è¿‡æ»¤å™¨åç§°)    â”‚   (å®ç°ç±»)      â”‚   (åˆå§‹åŒ–å‚æ•°)   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 <filter-mapping>                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  filter-name    â”‚   url-pattern   â”‚   dispatcher    â”‚ â”‚
â”‚ â”‚  (å…³è”è¿‡æ»¤å™¨)    â”‚   (URLæ¨¡å¼)     â”‚   (è¯·æ±‚ç±»å‹)    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 URLæ¨¡å¼é…ç½®è¯¦è§£


**ğŸ¯ URLæ¨¡å¼çš„å››ç§å†™æ³•**

```xml
<!-- 1. ç²¾ç¡®åŒ¹é…ï¼šåªåŒ¹é…ç‰¹å®šURL -->
<url-pattern>/admin/login</url-pattern>

<!-- 2. è·¯å¾„åŒ¹é…ï¼šåŒ¹é…è·¯å¾„ä¸‹æ‰€æœ‰èµ„æº -->
<url-pattern>/admin/*</url-pattern>

<!-- 3. æ‰©å±•ååŒ¹é…ï¼šåŒ¹é…ç‰¹å®šæ–‡ä»¶ç±»å‹ -->
<url-pattern>*.jsp</url-pattern>

<!-- 4. å…¨å±€åŒ¹é…ï¼šåŒ¹é…æ‰€æœ‰è¯·æ±‚ -->
<url-pattern>/*</url-pattern>
```

> **âš ï¸ é‡è¦æé†’**ï¼šURLæ¨¡å¼ä¼˜å…ˆçº§ä¸º `ç²¾ç¡®åŒ¹é… > è·¯å¾„åŒ¹é… > æ‰©å±•ååŒ¹é… > é»˜è®¤åŒ¹é…`

### 2.3 è¯·æ±‚åˆ†å‘ç±»å‹é…ç½®


**ğŸ“‹ dispatcherç±»å‹è¯´æ˜**

| **ç±»å‹** | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** | **ç¤ºä¾‹** |
|---------|---------|-------------|---------|
| **REQUEST** | `ç”¨æˆ·ç›´æ¥è¯·æ±‚` | `æ™®é€šçš„GET/POSTè¯·æ±‚` | `ç”¨æˆ·è®¿é—®é¡µé¢` |
| **FORWARD** | `å†…éƒ¨è½¬å‘è¯·æ±‚` | `RequestDispatcherè½¬å‘` | `ç™»å½•éªŒè¯è½¬å‘` |
| **INCLUDE** | `åŒ…å«è¯·æ±‚` | `jsp:includeåŠ¨æ€åŒ…å«` | `é¡µé¢ç‰‡æ®µåŒ…å«` |
| **ERROR** | `é”™è¯¯å¤„ç†è¯·æ±‚` | `é”™è¯¯é¡µé¢å¤„ç†` | `404/500é”™è¯¯` |

```xml
<!-- é…ç½®å¤šç§è¯·æ±‚ç±»å‹ -->
<filter-mapping>
    <filter-name>securityFilter</filter-name>
    <url-pattern>/admin/*</url-pattern>
    <dispatcher>REQUEST</dispatcher>
    <dispatcher>FORWARD</dispatcher>
</filter-mapping>
```

### 2.4 å®Œæ•´é…ç½®ç¤ºä¾‹


```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee" version="4.0">
    
    <!-- å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>CharacterEncodingFilter</filter-name>
        <filter-class>com.example.filter.CharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>UTF-8</param-value>
        </init-param>
        <init-param>
            <param-name>forceEncoding</param-name>
            <param-value>true</param-value>
        </init-param>
    </filter>
    
    <!-- ç™»å½•éªŒè¯è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>LoginCheckFilter</filter-name>
        <filter-class>com.example.filter.LoginCheckFilter</filter-class>
        <init-param>
            <param-name>excludeUrls</param-name>
            <param-value>/login,/register,/public</param-value>
        </init-param>
    </filter>
    
    <!-- è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºï¼šæŒ‰ç…§mappingåœ¨web.xmlä¸­çš„é¡ºåº -->
    <filter-mapping>
        <filter-name>CharacterEncodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
    
    <filter-mapping>
        <filter-name>LoginCheckFilter</filter-name>
        <url-pattern>/admin/*</url-pattern>
        <url-pattern>/user/*</url-pattern>
        <dispatcher>REQUEST</dispatcher>
    </filter-mapping>
    
</web-app>
```

---

## 3. ğŸ“ æ³¨è§£é…ç½®æ·±å…¥ç†è§£


### 3.1 @WebFilteræ³¨è§£åŸºç¡€


**ğŸ”¸ æ³¨è§£é…ç½®çš„ä¼˜åŠ¿**

æ³¨è§£é…ç½®å°±åƒç»™æ¯ä¸ªè¿‡æ»¤å™¨è´´ä¸Šæ ‡ç­¾ï¼Œæ ‡ç­¾ä¸Šå†™ç€"æˆ‘æ˜¯è°ï¼Œæˆ‘è¦å¤„ç†ä»€ä¹ˆ"ã€‚ç›¸æ¯”XMLé…ç½®ï¼Œæ³¨è§£æ›´ç›´è§‚ï¼Œä»£ç å’Œé…ç½®åœ¨ä¸€èµ·ï¼Œä¾¿äºç»´æŠ¤ã€‚

```java
// æœ€ç®€å•çš„æ³¨è§£é…ç½®
@WebFilter("/admin/*")
public class AdminFilter implements Filter {
    // è¿‡æ»¤å™¨å®ç°
}
```

### 3.2 @WebFilteræ³¨è§£è¯¦ç»†å‚æ•°


**ğŸ“‹ @WebFilteræ³¨è§£å‚æ•°è¯¦è§£**

| **å‚æ•°å** | **ç±»å‹** | **ä½œç”¨** | **ç¤ºä¾‹** |
|-----------|---------|---------|---------|
| **filterName** | `String` | `è¿‡æ»¤å™¨åç§°` | `@WebFilter(filterName="myFilter")` |
| **urlPatterns** | `String[]` | `URLæ¨¡å¼æ•°ç»„` | `urlPatterns={"/admin/*", "/user/*"}` |
| **value** | `String[]` | `urlPatternsåˆ«å` | `@WebFilter("/admin/*")` |
| **servletNames** | `String[]` | `ä½œç”¨äºç‰¹å®šServlet` | `servletNames={"loginServlet"}` |
| **dispatcherTypes** | `DispatcherType[]` | `è¯·æ±‚åˆ†å‘ç±»å‹` | `dispatcherTypes=REQUEST` |
| **initParams** | `WebInitParam[]` | `åˆå§‹åŒ–å‚æ•°` | `initParams={@WebInitParam(...)}` |

### 3.3 æ³¨è§£é…ç½®å®Œæ•´ç¤ºä¾‹


```java
/**
 * ç”¨æˆ·æƒé™éªŒè¯è¿‡æ»¤å™¨
 * åŠŸèƒ½ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œæ˜¯å¦æœ‰æƒé™è®¿é—®
 */
@WebFilter(
    filterName = "UserAuthFilter",           // è¿‡æ»¤å™¨åç§°
    urlPatterns = {"/admin/*", "/user/*"},   // è¦æ‹¦æˆªçš„URL
    dispatcherTypes = {                      // æ‹¦æˆªçš„è¯·æ±‚ç±»å‹
        DispatcherType.REQUEST,
        DispatcherType.FORWARD
    },
    initParams = {                           // åˆå§‹åŒ–å‚æ•°
        @WebInitParam(
            name = "loginUrl", 
            value = "/login.jsp"
        ),
        @WebInitParam(
            name = "excludePaths", 
            value = "/user/login,/user/register"
        )
    }
)
public class UserAuthFilter implements Filter {
    
    private String loginUrl;
    private Set<String> excludePaths;
    
    @Override
    public void init(FilterConfig config) throws ServletException {
        // è¯»å–é…ç½®å‚æ•°
        loginUrl = config.getInitParameter("loginUrl");
        String paths = config.getInitParameter("excludePaths");
        
        if (paths != null) {
            excludePaths = new HashSet<>(Arrays.asList(paths.split(",")));
        }
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        String path = req.getRequestURI();
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæ’é™¤è·¯å¾„
        if (excludePaths.contains(path)) {
            chain.doFilter(request, response);
            return;
        }
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
        HttpSession session = req.getSession(false);
        if (session == null || session.getAttribute("user") == null) {
            resp.sendRedirect(req.getContextPath() + loginUrl);
            return;
        }
        
        // ç”¨æˆ·å·²ç™»å½•ï¼Œç»§ç»­å¤„ç†
        chain.doFilter(request, response);
    }
}
```

### 3.4 æ³¨è§£é…ç½®æ³¨æ„äº‹é¡¹


**âš ï¸ ä½¿ç”¨æ³¨è§£é…ç½®éœ€è¦æ³¨æ„**

| **æ³¨æ„äº‹é¡¹** | **è¯´æ˜** | **è§£å†³æ–¹æ¡ˆ** |
|-------------|---------|-------------|
| **å®¹å™¨æ”¯æŒ** | `éœ€è¦Servlet 3.0+å®¹å™¨` | `ç¡®ä¿Tomcat 7+æˆ–ç›¸åº”ç‰ˆæœ¬` |
| **åŒ…æ‰«æ** | `éœ€è¦å¯ç”¨æ³¨è§£æ‰«æ` | `web.xmlä¸­è®¾ç½®metadata-complete="false"` |
| **æ‰§è¡Œé¡ºåº** | `æ³¨è§£æ— æ³•ç²¾ç¡®æ§åˆ¶é¡ºåº` | `ä½¿ç”¨FilterRegistrationBean` |
| **åŠ¨æ€é…ç½®** | `ç¼–è¯‘æ—¶ç¡®å®šï¼Œæ— æ³•è¿è¡Œæ—¶ä¿®æ”¹` | `è€ƒè™‘ä½¿ç”¨åŠ¨æ€æ³¨å†Œ` |

```xml
<!-- web.xmlä¸­å¯ç”¨æ³¨è§£æ‰«æ -->
<web-app metadata-complete="false" version="3.1">
    <!-- å…¶ä»–é…ç½® -->
</web-app>
```

---

## 4. âš™ï¸ åŠ¨æ€æ³¨å†Œæœºåˆ¶è¯¦è§£


### 4.1 åŠ¨æ€æ³¨å†Œçš„æ¦‚å¿µä¸ä¼˜åŠ¿


**ğŸ”¸ ä»€ä¹ˆæ˜¯åŠ¨æ€æ³¨å†Œ**

åŠ¨æ€æ³¨å†Œå°±åƒåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸´æ—¶å¢åŠ å®‰æ£€è®¾å¤‡ã€‚ä¸éœ€è¦äº‹å…ˆåœ¨é…ç½®æ–‡ä»¶é‡Œå†™å¥½ï¼Œè€Œæ˜¯æ ¹æ®å®é™…éœ€è¦ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶é€šè¿‡ä»£ç æ¥æ³¨å†Œè¿‡æ»¤å™¨ã€‚

**ğŸ’¡ åŠ¨æ€æ³¨å†Œçš„ä»·å€¼**
- **çµæ´»æ€§**ï¼šå¯ä»¥æ ¹æ®è¿è¡Œç¯å¢ƒå†³å®šæ˜¯å¦æ³¨å†Œè¿‡æ»¤å™¨
- **å¯ç¼–ç¨‹**ï¼šå¯ä»¥é€šè¿‡ä»£ç é€»è¾‘æ§åˆ¶è¿‡æ»¤å™¨é…ç½®
- **æ¨¡å—åŒ–**ï¼šä¸åŒæ¨¡å—å¯ä»¥ç‹¬ç«‹æ³¨å†Œè‡ªå·±çš„è¿‡æ»¤å™¨

### 4.2 ServletContextåŠ¨æ€æ³¨å†Œ


**ğŸ”§ åŸºæœ¬æ³¨å†Œè¯­æ³•**

```java
public class AppContextListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent event) {
        ServletContext context = event.getServletContext();
        
        // åŠ¨æ€æ³¨å†Œè¿‡æ»¤å™¨
        FilterRegistration.Dynamic filter = context.addFilter(
            "dynamicFilter",                    // è¿‡æ»¤å™¨åç§°
            new MyDynamicFilter()              // è¿‡æ»¤å™¨å®ä¾‹
        );
        
        // é…ç½®URLæ˜ å°„
        filter.addMappingForUrlPatterns(
            EnumSet.of(DispatcherType.REQUEST), // è¯·æ±‚ç±»å‹
            false,                              // æ˜¯å¦åŒ¹é…after
            "/api/*"                           // URLæ¨¡å¼
        );
        
        // è®¾ç½®åˆå§‹åŒ–å‚æ•°
        filter.setInitParameter("param1", "value1");
    }
}
```

### 4.3 æ¡ä»¶åŒ–æ³¨å†Œå®ä¾‹


**ğŸ¯ æ ¹æ®ç¯å¢ƒåŠ¨æ€æ³¨å†Œè¿‡æ»¤å™¨**

```java
@WebListener
public class DynamicFilterRegistration implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext context = sce.getServletContext();
        
        // è·å–è¿è¡Œç¯å¢ƒ
        String environment = System.getProperty("app.environment", "dev");
        
        // å¼€å‘ç¯å¢ƒï¼šæ³¨å†Œè°ƒè¯•è¿‡æ»¤å™¨
        if ("dev".equals(environment)) {
            registerDebugFilter(context);
        }
        
        // ç”Ÿäº§ç¯å¢ƒï¼šæ³¨å†Œæ€§èƒ½ç›‘æ§è¿‡æ»¤å™¨
        if ("prod".equals(environment)) {
            registerPerformanceFilter(context);
        }
        
        // æ‰€æœ‰ç¯å¢ƒï¼šæ ¹æ®é…ç½®å†³å®šæ˜¯å¦å¯ç”¨å®‰å…¨è¿‡æ»¤å™¨
        if (isSecurityEnabled()) {
            registerSecurityFilter(context);
        }
    }
    
    private void registerDebugFilter(ServletContext context) {
        FilterRegistration.Dynamic debugFilter = context.addFilter(
            "debugFilter", 
            DebugFilter.class
        );
        debugFilter.addMappingForUrlPatterns(
            EnumSet.allOf(DispatcherType.class), 
            false, 
            "/*"
        );
        debugFilter.setInitParameter("logLevel", "DEBUG");
    }
    
    private void registerPerformanceFilter(ServletContext context) {
        FilterRegistration.Dynamic perfFilter = context.addFilter(
            "performanceFilter", 
            PerformanceMonitorFilter.class
        );
        perfFilter.addMappingForUrlPatterns(
            EnumSet.of(DispatcherType.REQUEST), 
            false, 
            "/api/*"
        );
        perfFilter.setInitParameter("threshold", "1000"); // 1ç§’é˜ˆå€¼
    }
    
    private void registerSecurityFilter(ServletContext context) {
        FilterRegistration.Dynamic secFilter = context.addFilter(
            "securityFilter", 
            SecurityFilter.class
        );
        secFilter.addMappingForUrlPatterns(
            EnumSet.of(DispatcherType.REQUEST, DispatcherType.FORWARD), 
            false, 
            "/admin/*", "/secure/*"
        );
    }
    
    private boolean isSecurityEnabled() {
        // ä»é…ç½®æ–‡ä»¶æˆ–æ•°æ®åº“è¯»å–å®‰å…¨é…ç½®
        return Boolean.parseBoolean(
            System.getProperty("security.enabled", "true")
        );
    }
}
```

### 4.4 åŠ¨æ€æ³¨å†Œé«˜çº§ç‰¹æ€§


**ğŸ“Š è¿‡æ»¤å™¨ä¼˜å…ˆçº§æ§åˆ¶**

```java
// æ§åˆ¶è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº
public void registerFiltersWithOrder(ServletContext context) {
    
    // ç¬¬ä¸€ä¸ªæ‰§è¡Œï¼šç¼–ç è¿‡æ»¤å™¨
    FilterRegistration.Dynamic encodingFilter = context.addFilter(
        "encoding", EncodingFilter.class
    );
    encodingFilter.addMappingForUrlPatterns(
        EnumSet.of(DispatcherType.REQUEST), 
        false,    // isMatchAfter=falseï¼Œä¼˜å…ˆçº§é«˜
        "/*"
    );
    
    // ç¬¬äºŒä¸ªæ‰§è¡Œï¼šè®¤è¯è¿‡æ»¤å™¨
    FilterRegistration.Dynamic authFilter = context.addFilter(
        "auth", AuthenticationFilter.class
    );
    authFilter.addMappingForUrlPatterns(
        EnumSet.of(DispatcherType.REQUEST), 
        true,     // isMatchAfter=trueï¼Œåœ¨å·²æœ‰è¿‡æ»¤å™¨ä¹‹å
        "/secure/*"
    );
}
```

---

## 5. ğŸƒ Spring Bootè‡ªåŠ¨é…ç½®


### 5.1 Spring Bootè¿‡æ»¤å™¨é…ç½®æ¦‚è¿°


**ğŸ”¸ Spring Booté…ç½®ç†å¿µ**

Spring BootæŠŠè¿‡æ»¤å™¨é…ç½®å˜å¾—åƒæ­ç§¯æœ¨ä¸€æ ·ç®€å•ã€‚ä½ åªéœ€è¦å‘Šè¯‰Spring Boot"æˆ‘æœ‰ä¸€ä¸ªè¿‡æ»¤å™¨"ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å¸®ä½ å®Œæˆæ³¨å†Œã€é…ç½®ã€ç®¡ç†ç­‰æ‰€æœ‰å·¥ä½œã€‚

**ğŸ’« Spring Booté…ç½®ä¼˜åŠ¿**
- **é›¶é…ç½®**ï¼šè‡ªåŠ¨æ‰«æå’Œæ³¨å†Œ
- **æ™ºèƒ½åŒ–**ï¼šæ ¹æ®æ¡ä»¶è‡ªåŠ¨å¯ç”¨/ç¦ç”¨
- **é›†æˆæ€§**ï¼šä¸Springç”Ÿæ€å®Œç¾ç»“åˆ
- **é…ç½®å¤–éƒ¨åŒ–**ï¼šæ”¯æŒapplication.ymlé…ç½®

### 5.2 FilterRegistrationBeané…ç½®


**ğŸ”§ æ ‡å‡†é…ç½®æ–¹æ³•**

```java
@Configuration
public class FilterConfig {
    
    /**
     * æ³¨å†Œå­—ç¬¦ç¼–ç è¿‡æ»¤å™¨
     */
    @Bean
    public FilterRegistrationBean<CharacterEncodingFilter> encodingFilter() {
        FilterRegistrationBean<CharacterEncodingFilter> registration = 
            new FilterRegistrationBean<>();
        
        // è®¾ç½®è¿‡æ»¤å™¨å®ä¾‹
        CharacterEncodingFilter filter = new CharacterEncodingFilter();
        filter.setEncoding("UTF-8");
        filter.setForceEncoding(true);
        registration.setFilter(filter);
        
        // é…ç½®URLæ¨¡å¼
        registration.addUrlPatterns("/*");
        
        // è®¾ç½®æ‰§è¡Œé¡ºåºï¼ˆæ•°å­—è¶Šå°è¶Šå…ˆæ‰§è¡Œï¼‰
        registration.setOrder(1);
        
        // è®¾ç½®è¿‡æ»¤å™¨åç§°
        registration.setName("characterEncodingFilter");
        
        return registration;
    }
    
    /**
     * æ³¨å†Œè‡ªå®šä¹‰æƒé™éªŒè¯è¿‡æ»¤å™¨
     */
    @Bean
    public FilterRegistrationBean<AuthFilter> authFilter() {
        FilterRegistrationBean<AuthFilter> registration = 
            new FilterRegistrationBean<>();
        
        registration.setFilter(new AuthFilter());
        registration.addUrlPatterns("/admin/*", "/user/*");
        registration.setOrder(2); // åœ¨ç¼–ç è¿‡æ»¤å™¨ä¹‹åæ‰§è¡Œ
        
        // è®¾ç½®åˆå§‹åŒ–å‚æ•°
        Map<String, String> params = new HashMap<>();
        params.put("loginUrl", "/login");
        params.put("excludeUrls", "/login,/register");
        registration.setInitParameters(params);
        
        return registration;
    }
}
```

### 5.3 æ¡ä»¶åŒ–é…ç½®


**ğŸ¯ æ ¹æ®é…ç½®å±æ€§åŠ¨æ€å¯ç”¨è¿‡æ»¤å™¨**

```java
@Configuration
public class ConditionalFilterConfig {
    
    /**
     * åªåœ¨å¼€å‘ç¯å¢ƒå¯ç”¨è°ƒè¯•è¿‡æ»¤å™¨
     */
    @Bean
    @Profile("dev") // åªåœ¨devç¯å¢ƒç”Ÿæ•ˆ
    public FilterRegistrationBean<DebugFilter> debugFilter() {
        FilterRegistrationBean<DebugFilter> registration = 
            new FilterRegistrationBean<>();
        registration.setFilter(new DebugFilter());
        registration.addUrlPatterns("/*");
        registration.setOrder(0);
        return registration;
    }
    
    /**
     * æ ¹æ®é…ç½®å±æ€§å†³å®šæ˜¯å¦å¯ç”¨CORSè¿‡æ»¤å™¨
     */
    @Bean
    @ConditionalOnProperty(
        name = "app.cors.enabled", 
        havingValue = "true", 
        matchIfMissing = false
    )
    public FilterRegistrationBean<CorsFilter> corsFilter() {
        FilterRegistrationBean<CorsFilter> registration = 
            new FilterRegistrationBean<>();
        registration.setFilter(new CorsFilter());
        registration.addUrlPatterns("/api/*");
        registration.setOrder(10);
        return registration;
    }
    
    /**
     * åªæœ‰åœ¨Rediså¯ç”¨æ—¶æ‰å¯ç”¨ä¼šè¯è¿‡æ»¤å™¨
     */
    @Bean
    @ConditionalOnClass(RedisTemplate.class)
    @ConditionalOnProperty(name = "spring.redis.host")
    public FilterRegistrationBean<RedisSessionFilter> sessionFilter() {
        FilterRegistrationBean<RedisSessionFilter> registration = 
            new FilterRegistrationBean<>();
        registration.setFilter(new RedisSessionFilter());
        registration.addUrlPatterns("/secure/*");
        registration.setOrder(5);
        return registration;
    }
}
```

### 5.4 é…ç½®å±æ€§å¤–éƒ¨åŒ–


**ğŸ“‹ application.ymlé…ç½®ç¤ºä¾‹**

```yaml
# åº”ç”¨ç¨‹åºé…ç½®
app:
  # è¿‡æ»¤å™¨å¼€å…³é…ç½®
  filters:
    cors:
      enabled: true
      allowed-origins: 
        - "http://localhost:3000"
        - "https://example.com"
    security:
      enabled: true
      login-url: "/login"
      exclude-paths:
        - "/public/**"
        - "/static/**"
    performance:
      enabled: false
      threshold: 1000
      
# ç¯å¢ƒç‰¹å®šé…ç½®
---
spring:
  profiles: dev
app:
  filters:
    debug: true
    performance:
      enabled: true
      
---
spring:
  profiles: prod
app:
  filters:
    debug: false
    security:
      enabled: true
```

**ğŸ”§ é…ç½®å±æ€§ç±»**

```java
@ConfigurationProperties(prefix = "app.filters")
@Component
public class FilterProperties {
    
    private Cors cors = new Cors();
    private Security security = new Security();
    private Performance performance = new Performance();
    
    // getterå’Œsetteræ–¹æ³•
    
    public static class Cors {
        private boolean enabled = false;
        private List<String> allowedOrigins = new ArrayList<>();
        // getterå’Œsetter
    }
    
    public static class Security {
        private boolean enabled = true;
        private String loginUrl = "/login";
        private List<String> excludePaths = new ArrayList<>();
        // getterå’Œsetter
    }
    
    public static class Performance {
        private boolean enabled = false;
        private long threshold = 1000;
        // getterå’Œsetter
    }
}
```

---

## 6. ğŸ”§ é…ç½®å‚æ•°ä¼ é€’ä¸ç®¡ç†


### 6.1 åˆå§‹åŒ–å‚æ•°çš„ä½œç”¨


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦åˆå§‹åŒ–å‚æ•°**

åˆå§‹åŒ–å‚æ•°å°±åƒç»™è¿‡æ»¤å™¨æä¾›"ä½¿ç”¨è¯´æ˜ä¹¦"ï¼Œå‘Šè¯‰è¿‡æ»¤å™¨"ä½ åº”è¯¥æ€ä¹ˆå·¥ä½œ"ã€‚æ¯”å¦‚ç¼–ç è¿‡æ»¤å™¨éœ€è¦çŸ¥é“ç”¨ä»€ä¹ˆç¼–ç ï¼Œæƒé™è¿‡æ»¤å™¨éœ€è¦çŸ¥é“å“ªäº›é¡µé¢ä¸éœ€è¦æ£€æŸ¥æƒé™ã€‚

**ğŸ’¡ å‚æ•°ä¼ é€’çš„ä¸‰ç§å±‚çº§**
- **å…¨å±€å‚æ•°**ï¼šæ•´ä¸ªåº”ç”¨çš„é€šç”¨é…ç½®
- **è¿‡æ»¤å™¨å‚æ•°**ï¼šç‰¹å®šè¿‡æ»¤å™¨çš„ä¸“ç”¨é…ç½®  
- **è¿è¡Œæ—¶å‚æ•°**ï¼šç¨‹åºæ‰§è¡Œæ—¶çš„åŠ¨æ€é…ç½®

### 6.2 web.xmlå‚æ•°é…ç½®


**ğŸ“‹ XMLé…ç½®å‚æ•°ç¤ºä¾‹**

```xml
<web-app>
    <!-- å…¨å±€ä¸Šä¸‹æ–‡å‚æ•° -->
    <context-param>
        <param-name>globalConfig</param-name>
        <param-value>production</param-value>
    </context-param>
    
    <!-- è¿‡æ»¤å™¨ä¸“ç”¨å‚æ•° -->
    <filter>
        <filter-name>securityFilter</filter-name>
        <filter-class>com.example.SecurityFilter</filter-class>
        
        <!-- å•ä¸ªå‚æ•°é…ç½® -->
        <init-param>
            <param-name>loginUrl</param-name>
            <param-value>/login.jsp</param-value>
        </init-param>
        
        <!-- å¤šå€¼å‚æ•°é…ç½® -->
        <init-param>
            <param-name>excludeUrls</param-name>
            <param-value>/login,/register,/public,/static</param-value>
        </init-param>
        
        <!-- å¸ƒå°”å‚æ•°é…ç½® -->
        <init-param>
            <param-name>enableLogging</param-name>
            <param-value>true</param-value>
        </init-param>
        
        <!-- æ•°å­—å‚æ•°é…ç½® -->
        <init-param>
            <param-name>sessionTimeout</param-name>
            <param-value>1800</param-value>
        </init-param>
    </filter>
</web-app>
```

### 6.3 å‚æ•°è¯»å–ä¸å¤„ç†


**ğŸ”§ åœ¨è¿‡æ»¤å™¨ä¸­è¯»å–å‚æ•°**

```java
public class ConfigurableFilter implements Filter {
    
    // é…ç½®å‚æ•°å­—æ®µ
    private String loginUrl;
    private Set<String> excludeUrls;
    private boolean enableLogging;
    private int sessionTimeout;
    private String environment;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        
        // 1. è¯»å–è¿‡æ»¤å™¨åˆå§‹åŒ–å‚æ•°
        loginUrl = getParameter(filterConfig, "loginUrl", "/login.jsp");
        enableLogging = getBooleanParameter(filterConfig, "enableLogging", false);
        sessionTimeout = getIntParameter(filterConfig, "sessionTimeout", 1800);
        
        // 2. å¤„ç†å¤šå€¼å‚æ•°
        String excludeUrlsStr = filterConfig.getInitParameter("excludeUrls");
        if (excludeUrlsStr != null) {
            excludeUrls = new HashSet<>(Arrays.asList(excludeUrlsStr.split(",")));
        } else {
            excludeUrls = new HashSet<>();
        }
        
        // 3. è¯»å–å…¨å±€ä¸Šä¸‹æ–‡å‚æ•°
        ServletContext context = filterConfig.getServletContext();
        environment = context.getInitParameter("globalConfig");
        
        // 4. å‚æ•°éªŒè¯
        validateParameters();
        
        // 5. æ ¹æ®å‚æ•°åˆå§‹åŒ–ç»„ä»¶
        initializeComponents();
    }
    
    // å‚æ•°è¯»å–è¾…åŠ©æ–¹æ³•
    private String getParameter(FilterConfig config, String name, String defaultValue) {
        String value = config.getInitParameter(name);
        return value != null ? value : defaultValue;
    }
    
    private boolean getBooleanParameter(FilterConfig config, String name, boolean defaultValue) {
        String value = config.getInitParameter(name);
        return value != null ? Boolean.parseBoolean(value) : defaultValue;
    }
    
    private int getIntParameter(FilterConfig config, String name, int defaultValue) {
        String value = config.getInitParameter(name);
        try {
            return value != null ? Integer.parseInt(value) : defaultValue;
        } catch (NumberFormatException e) {
            return defaultValue;
        }
    }
    
    private void validateParameters() {
        if (sessionTimeout < 60) {
            throw new IllegalArgumentException("ä¼šè¯è¶…æ—¶æ—¶é—´ä¸èƒ½å°‘äº60ç§’");
        }
        if (loginUrl == null || loginUrl.trim().isEmpty()) {
            throw new IllegalArgumentException("ç™»å½•URLä¸èƒ½ä¸ºç©º");
        }
    }
    
    private void initializeComponents() {
        if (enableLogging) {
            // åˆå§‹åŒ–æ—¥å¿—ç»„ä»¶
            System.out.println("è¿‡æ»¤å™¨æ—¥å¿—åŠŸèƒ½å·²å¯ç”¨ï¼Œç¯å¢ƒï¼š" + environment);
        }
    }
}
```

### 6.4 é«˜çº§å‚æ•°ç®¡ç†æŠ€å·§


**ğŸ¯ é…ç½®æ–‡ä»¶é›†æˆ**

```java
public class PropertiesConfigFilter implements Filter {
    
    private Properties configProperties;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // ä»å¤šä¸ªæºåŠ è½½é…ç½®
        configProperties = new Properties();
        
        // 1. åŠ è½½é»˜è®¤é…ç½®
        loadDefaultProperties();
        
        // 2. åŠ è½½å¤–éƒ¨é…ç½®æ–‡ä»¶
        String configFile = filterConfig.getInitParameter("configFile");
        if (configFile != null) {
            loadExternalProperties(configFile);
        }
        
        // 3. è¦†ç›–ç³»ç»Ÿå±æ€§
        loadSystemProperties();
        
        // 4. è¦†ç›–åˆå§‹åŒ–å‚æ•°
        overrideWithInitParams(filterConfig);
    }
    
    private void loadDefaultProperties() {
        configProperties.setProperty("maxRetries", "3");
        configProperties.setProperty("timeout", "5000");
        configProperties.setProperty("enableCache", "true");
    }
    
    private void loadExternalProperties(String configFile) {
        try (InputStream is = getClass().getClassLoader()
                .getResourceAsStream(configFile)) {
            if (is != null) {
                configProperties.load(is);
            }
        } catch (IOException e) {
            // è®°å½•è­¦å‘Šä½†ä¸å½±å“å¯åŠ¨
            System.out.println("è­¦å‘Šï¼šæ— æ³•åŠ è½½é…ç½®æ–‡ä»¶ " + configFile);
        }
    }
    
    private void loadSystemProperties() {
        // ä»ç³»ç»Ÿå±æ€§ä¸­è¯»å–é…ç½®ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰
        System.getProperties().forEach((key, value) -> {
            String keyStr = key.toString();
            if (keyStr.startsWith("filter.")) {
                String filterKey = keyStr.substring(7); // å»æ‰"filter."å‰ç¼€
                configProperties.setProperty(filterKey, value.toString());
            }
        });
    }
    
    private void overrideWithInitParams(FilterConfig filterConfig) {
        // åˆå§‹åŒ–å‚æ•°å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§
        Enumeration<String> paramNames = filterConfig.getInitParameterNames();
        while (paramNames.hasMoreElements()) {
            String paramName = paramNames.nextElement();
            String paramValue = filterConfig.getInitParameter(paramName);
            configProperties.setProperty(paramName, paramValue);
        }
    }
    
    // æä¾›ä¾¿æ·çš„é…ç½®è¯»å–æ–¹æ³•
    public String getConfig(String key, String defaultValue) {
        return configProperties.getProperty(key, defaultValue);
    }
    
    public int getIntConfig(String key, int defaultValue) {
        String value = configProperties.getProperty(key);
        try {
            return value != null ? Integer.parseInt(value) : defaultValue;
        } catch (NumberFormatException e) {
            return defaultValue;
        }
    }
    
    public boolean getBooleanConfig(String key, boolean defaultValue) {
        String value = configProperties.getProperty(key);
        return value != null ? Boolean.parseBoolean(value) : defaultValue;
    }
}
```

---

## 7. ğŸŒ ç¯å¢ƒå˜é‡é›†æˆå®è·µ


### 7.1 ç¯å¢ƒå˜é‡çš„ä½œç”¨ä¸ä»·å€¼


**ğŸ”¸ ä¸ºä»€ä¹ˆä½¿ç”¨ç¯å¢ƒå˜é‡**

ç¯å¢ƒå˜é‡å°±åƒç»™åº”ç”¨ç¨‹åºæä¾›"èº«ä»½è¯"ï¼Œå‘Šè¯‰åº”ç”¨ç¨‹åº"ä½ ç°åœ¨åœ¨å“ªä¸ªç¯å¢ƒè¿è¡Œ"ã€‚è¿™æ ·åŒä¸€å¥—ä»£ç å¯ä»¥åœ¨å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰ä¸åŒç¯å¢ƒä¸­æœ‰ä¸åŒçš„è¡Œä¸ºã€‚

**ğŸ’¡ ç¯å¢ƒå˜é‡çš„ä¼˜åŠ¿**
- **å®‰å…¨æ€§**ï¼šæ•æ„Ÿä¿¡æ¯ä¸å†™åœ¨ä»£ç é‡Œ
- **çµæ´»æ€§**ï¼šä¸é‡æ–°ç¼–è¯‘å°±èƒ½æ”¹å˜é…ç½®
- **æ ‡å‡†åŒ–**ï¼šç¬¦åˆ12-Factoråº”ç”¨åŸåˆ™

### 7.2 ç³»ç»Ÿç¯å¢ƒå˜é‡é›†æˆ


**ğŸ”§ è¯»å–ç¯å¢ƒå˜é‡çš„æ ‡å‡†æ–¹æ³•**

```java
public class EnvironmentAwareFilter implements Filter {
    
    private String databaseUrl;
    private String apiKey;
    private String logLevel;
    private boolean debugMode;
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        
        // 1. ä¼˜å…ˆä»ç¯å¢ƒå˜é‡è¯»å–
        databaseUrl = getEnvironmentVariable("DATABASE_URL", 
            "jdbc:mysql://localhost:3306/default");
            
        apiKey = getEnvironmentVariable("API_KEY", null);
        
        logLevel = getEnvironmentVariable("LOG_LEVEL", "INFO");
        
        debugMode = getBooleanEnvironmentVariable("DEBUG_MODE", false);
        
        // 2. éªŒè¯å…³é”®é…ç½®
        if (apiKey == null) {
            throw new ServletException("API_KEYç¯å¢ƒå˜é‡æœªè®¾ç½®");
        }
        
        // 3. æ ¹æ®ç¯å¢ƒè°ƒæ•´è¡Œä¸º
        adjustBehaviorByEnvironment();
    }
    
    /**
     * è¯»å–å­—ç¬¦ä¸²ç±»å‹ç¯å¢ƒå˜é‡
     */
    private String getEnvironmentVariable(String name, String defaultValue) {
        String value = System.getenv(name);
        if (value == null || value.trim().isEmpty()) {
            value = System.getProperty(name, defaultValue);
        }
        return value;
    }
    
    /**
     * è¯»å–å¸ƒå°”ç±»å‹ç¯å¢ƒå˜é‡
     */
    private boolean getBooleanEnvironmentVariable(String name, boolean defaultValue) {
        String value = getEnvironmentVariable(name, String.valueOf(defaultValue));
        return Boolean.parseBoolean(value);
    }
    
    /**
     * æ ¹æ®ç¯å¢ƒè°ƒæ•´è¿‡æ»¤å™¨è¡Œä¸º
     */
    private void adjustBehaviorByEnvironment() {
        String environment = getEnvironmentVariable("APP_ENV", "development");
        
        switch (environment.toLowerCase()) {
            case "development":
                // å¼€å‘ç¯å¢ƒï¼šå¯ç”¨è¯¦ç»†æ—¥å¿—ï¼Œç¦ç”¨ç¼“å­˜
                logLevel = "DEBUG";
                debugMode = true;
                break;
                
            case "testing":
                // æµ‹è¯•ç¯å¢ƒï¼šå¯ç”¨æµ‹è¯•æ¨¡å¼
                logLevel = "INFO";
                debugMode = false;
                break;
                
            case "production":
                // ç”Ÿäº§ç¯å¢ƒï¼šä¼˜åŒ–æ€§èƒ½ï¼Œå¯ç”¨å®‰å…¨ç‰¹æ€§
                logLevel = "WARN";
                debugMode = false;
                break;
                
            default:
                System.out.println("è­¦å‘Šï¼šæœªçŸ¥ç¯å¢ƒ " + environment + "ï¼Œä½¿ç”¨é»˜è®¤é…ç½®");
        }
    }
}
```

### 7.3 Dockerç¯å¢ƒå˜é‡é›†æˆ


**ğŸ³ Dockeréƒ¨ç½²é…ç½®ç¤ºä¾‹**

```dockerfile
# Dockerfile
FROM openjdk:8-jre-alpine

# è®¾ç½®ç¯å¢ƒå˜é‡é»˜è®¤å€¼
ENV APP_ENV=production
ENV LOG_LEVEL=INFO
ENV DATABASE_URL=jdbc:mysql://db:3306/myapp
ENV DEBUG_MODE=false

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY app.war /usr/local/tomcat/webapps/

EXPOSE 8080

CMD ["catalina.sh", "run"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  web:
    build: .
    environment:
      # è¦†ç›–Dockerfileä¸­çš„é»˜è®¤å€¼
      - APP_ENV=development
      - DEBUG_MODE=true
      - DATABASE_URL=jdbc:mysql://mysql:3306/devdb
      - API_KEY=${API_KEY}  # ä»ä¸»æœºç¯å¢ƒå˜é‡è¯»å–
      - LOG_LEVEL=DEBUG
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      
  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=rootpass
      - MYSQL_DATABASE=devdb
    volumes:
      - mysql_data:/var/lib/mysql

volumes:
  mysql_data:
```

### 7.4 Spring Bootç¯å¢ƒå˜é‡é›†æˆ


**ğŸƒ Spring Booté…ç½®ä¼˜å…ˆçº§**

```yaml
# application.yml - åŸºç¡€é…ç½®
app:
  security:
    enabled: ${SECURITY_ENABLED:true}    # ç¯å¢ƒå˜é‡ï¼Œé»˜è®¤true
    jwt-secret: ${JWT_SECRET:defaultkey} # ç¯å¢ƒå˜é‡ï¼Œé»˜è®¤å€¼
  
  database:
    url: ${DATABASE_URL:jdbc:h2:mem:testdb}
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD:}
    
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    
  external-api:
    base-url: ${API_BASE_URL:https://api.example.com}
    api-key: ${API_KEY:}  # å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡æä¾›
    timeout: ${API_TIMEOUT:5000}

---
# å¼€å‘ç¯å¢ƒé…ç½®
spring:
  profiles: dev
app:
  security:
    enabled: false
  database:
    url: jdbc:h2:mem:devdb
    
---
# ç”Ÿäº§ç¯å¢ƒé…ç½®  
spring:
  profiles: prod
app:
  security:
    enabled: true
```

**ğŸ”§ ç¯å¢ƒæ„ŸçŸ¥è¿‡æ»¤å™¨é…ç½®**

```java
@Component
@ConfigurationProperties(prefix = "app")
public class AppConfig {
    
    private Security security = new Security();
    private Database database = new Database();
    private ExternalApi externalApi = new ExternalApi();
    
    // åµŒå¥—é…ç½®ç±»
    public static class Security {
        private boolean enabled;
        private String jwtSecret;
        // getter/setter
    }
    
    public static class Database {
        private String url;
        private String username;
        private String password;
        // getter/setter
    }
    
    public static class ExternalApi {
        private String baseUrl;
        private String apiKey;
        private int timeout;
        // getter/setter
    }
    
    // ä¸»é…ç½®ç±»çš„getter/setter
}

@Configuration
public class EnvironmentBasedFilterConfig {
    
    @Autowired
    private AppConfig appConfig;
    
    @Bean
    @ConditionalOnProperty(name = "app.security.enabled", havingValue = "true")
    public FilterRegistrationBean<SecurityFilter> securityFilter() {
        FilterRegistrationBean<SecurityFilter> registration = 
            new FilterRegistrationBean<>();
        
        SecurityFilter filter = new SecurityFilter();
        filter.setJwtSecret(appConfig.getSecurity().getJwtSecret());
        
        registration.setFilter(filter);
        registration.addUrlPatterns("/api/*");
        registration.setOrder(1);
        
        return registration;
    }
    
    @Bean
    @ConditionalOnProperty(name = "app.external-api.api-key")
    public FilterRegistrationBean<ApiKeyFilter> apiKeyFilter() {
        FilterRegistrationBean<ApiKeyFilter> registration = 
            new FilterRegistrationBean<>();
        
        ApiKeyFilter filter = new ApiKeyFilter();
        filter.setApiKey(appConfig.getExternalApi().getApiKey());
        filter.setBaseUrl(appConfig.getExternalApi().getBaseUrl());
        
        registration.setFilter(filter);
        registration.addUrlPatterns("/external/*");
        registration.setOrder(2);
        
        return registration;
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¿‡æ»¤å™¨é…ç½®æœ¬è´¨ï¼šå‘Šè¯‰Webå®¹å™¨ä½•æ—¶ã€å¦‚ä½•ä½¿ç”¨è¿‡æ»¤å™¨
ğŸ”¸ å››ç§é…ç½®æ–¹å¼ï¼šweb.xmlã€@WebFilterã€åŠ¨æ€æ³¨å†Œã€Spring Boot
ğŸ”¸ URLæ¨¡å¼åŒ¹é…ï¼šç²¾ç¡®åŒ¹é… > è·¯å¾„åŒ¹é… > æ‰©å±•ååŒ¹é… > é»˜è®¤åŒ¹é…
ğŸ”¸ è¯·æ±‚åˆ†å‘ç±»å‹ï¼šREQUESTã€FORWARDã€INCLUDEã€ERROR
ğŸ”¸ æ‰§è¡Œé¡ºåºæ§åˆ¶ï¼šweb.xmlæŒ‰mappingé¡ºåºï¼Œæ³¨è§£éœ€ç‰¹æ®Šå¤„ç†
ğŸ”¸ å‚æ•°ä¼ é€’æœºåˆ¶ï¼šinit-paramã€context-paramã€ç¯å¢ƒå˜é‡
ğŸ”¸ ç¯å¢ƒå˜é‡é›†æˆï¼š12-Factoråº”ç”¨åŸåˆ™ï¼Œé…ç½®å¤–éƒ¨åŒ–
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é…ç½®æ–¹å¼é€‰æ‹©ç­–ç•¥**
```
ç®€å•é¡¹ç›® â†’ @WebFilteræ³¨è§£é…ç½®
ä¼ ç»Ÿé¡¹ç›® â†’ web.xmlé…ç½®
å¤æ‚ä¸šåŠ¡ â†’ åŠ¨æ€æ³¨å†Œ
å¾®æœåŠ¡é¡¹ç›® â†’ Spring Booté…ç½®
```

**ğŸ”¹ å‚æ•°é…ç½®ä¼˜å…ˆçº§**
```
ç¯å¢ƒå˜é‡ > ç³»ç»Ÿå±æ€§ > init-param > é»˜è®¤å€¼
è¿™æ ·çš„ä¼˜å…ˆçº§ç¡®ä¿äº†é…ç½®çš„çµæ´»æ€§å’Œå®‰å…¨æ€§
```

**ğŸ”¹ è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºè§„å¾‹**
```
web.xmlï¼šæŒ‰<filter-mapping>å£°æ˜é¡ºåº
æ³¨è§£ï¼šæŒ‰ç±»åå­—æ¯é¡ºåºï¼ˆä¸å¯é ï¼‰
åŠ¨æ€æ³¨å†Œï¼šé€šè¿‡isMatchAfterå‚æ•°æ§åˆ¶
Spring Bootï¼šé€šè¿‡@Orderæˆ–setOrderæ§åˆ¶
```

### 8.3 å®é™…åº”ç”¨æœ€ä½³å®è·µ


**ğŸ’¼ ä¼ä¸šå¼€å‘å»ºè®®**
- **é…ç½®é›†ä¸­åŒ–**ï¼šä½¿ç”¨é…ç½®ç±»ç»Ÿä¸€ç®¡ç†è¿‡æ»¤å™¨é…ç½®
- **ç¯å¢ƒåˆ†ç¦»**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®å‚æ•°
- **å‚æ•°éªŒè¯**ï¼šåœ¨initæ–¹æ³•ä¸­éªŒè¯å…³é”®å‚æ•°
- **æ—¥å¿—è®°å½•**ï¼šè®°å½•è¿‡æ»¤å™¨çš„åˆå§‹åŒ–å’Œé…ç½®ä¿¡æ¯
- **ä¼˜é›…é™çº§**ï¼šé…ç½®é”™è¯¯æ—¶æä¾›åˆç†çš„é»˜è®¤è¡Œä¸º

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
- **æ¡ä»¶æ³¨å†Œ**ï¼šæ ¹æ®å®é™…éœ€è¦åŠ¨æ€æ³¨å†Œè¿‡æ»¤å™¨
- **é¡ºåºä¼˜åŒ–**ï¼šæŠŠæ‰§è¡Œé¢‘ç‡é«˜çš„è¿‡æ»¤å™¨æ”¾åœ¨å‰é¢
- **å‚æ•°ç¼“å­˜**ï¼šé¿å…é‡å¤è§£æé…ç½®å‚æ•°
- **èµ„æºå¤ç”¨**ï¼šåœ¨å¤šä¸ªè¿‡æ»¤å™¨é—´å…±äº«é…ç½®å¯¹è±¡

**âš ï¸ å¸¸è§é”™è¯¯é¿å…**
- **URLæ¨¡å¼é”™è¯¯**ï¼šæ³¨æ„/*å’Œ/**çš„åŒºåˆ«
- **é¡ºåºæ··ä¹±**ï¼šæ˜ç¡®è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºè¦æ±‚
- **å‚æ•°ç±»å‹é”™è¯¯**ï¼šæ­£ç¡®å¤„ç†å­—ç¬¦ä¸²åˆ°å…¶ä»–ç±»å‹çš„è½¬æ¢
- **ç©ºæŒ‡é’ˆå¼‚å¸¸**ï¼šæ£€æŸ¥å‚æ•°å€¼æ˜¯å¦ä¸ºnull

### 8.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ“š æ·±å…¥å­¦ä¹ æ–¹å‘**
- **è¿‡æ»¤å™¨é“¾æœºåˆ¶**ï¼šç†è§£FilterChainçš„å·¥ä½œåŸç†
- **å¼‚æ­¥å¤„ç†æ”¯æŒ**ï¼šå­¦ä¹ å¼‚æ­¥Servletä¸­çš„è¿‡æ»¤å™¨è¡Œä¸º
- **æ€§èƒ½ç›‘æ§**ï¼šå®ç°è¿‡æ»¤å™¨æ€§èƒ½ç»Ÿè®¡å’Œç›‘æ§
- **å®‰å…¨å¢å¼º**ï¼šæ·±å…¥å­¦ä¹ å®‰å…¨ç›¸å…³çš„è¿‡æ»¤å™¨å®ç°

**ğŸ”§ å®æˆ˜é¡¹ç›®å»ºè®®**
- **å¤šç¯å¢ƒéƒ¨ç½²**ï¼šå®ç°å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ç®¡ç†
- **é…ç½®ä¸­å¿ƒé›†æˆ**ï¼šä¸Nacosã€Apolloç­‰é…ç½®ä¸­å¿ƒé›†æˆ
- **ç›‘æ§å‘Šè­¦**ï¼šå®ç°è¿‡æ»¤å™¨å¼‚å¸¸ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- **æ€§èƒ½è°ƒä¼˜**ï¼šä¼˜åŒ–é«˜å¹¶å‘åœºæ™¯ä¸‹çš„è¿‡æ»¤å™¨æ€§èƒ½

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è¿‡æ»¤å™¨é…ç½®æœ‰å››æ‹›ï¼šXMLæ³¨è§£åŠ¨æ€Boot
URLæ¨¡å¼ç²¾ç¡®ä¼˜å…ˆï¼Œåˆ†å‘ç±»å‹è¦è®°ç‰¢
å‚æ•°ä¼ é€’å¤šå±‚æ¬¡ï¼Œç¯å¢ƒå˜é‡æœ€çµæ´»
æ‰§è¡Œé¡ºåºéœ€æ˜ç¡®ï¼Œæ€§èƒ½å®‰å…¨ä¸¤æ‰‹æŠ“
```