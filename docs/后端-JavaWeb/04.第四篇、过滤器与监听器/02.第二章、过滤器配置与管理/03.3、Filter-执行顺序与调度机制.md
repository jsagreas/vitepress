---
title: 3ã€Filter-æ‰§è¡Œé¡ºåºä¸è°ƒåº¦æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºåŸºç¡€](#1-è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºåŸºç¡€)
2. [FilterChainè°ƒç”¨æœºåˆ¶](#2-filterchainè°ƒç”¨æœºåˆ¶)
3. [REQUESTè¯·æ±‚è°ƒåº¦](#3-requestè¯·æ±‚è°ƒåº¦)
4. [FORWARDè½¬å‘è°ƒåº¦](#4-forwardè½¬å‘è°ƒåº¦)
5. [INCLUDEåŒ…å«è°ƒåº¦](#5-includeåŒ…å«è°ƒåº¦)
6. [ERRORé”™è¯¯è°ƒåº¦](#6-erroré”™è¯¯è°ƒåº¦)
7. [ASYNCå¼‚æ­¥è°ƒåº¦](#7-asyncå¼‚æ­¥è°ƒåº¦)
8. [å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ](#8-å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºåŸºç¡€


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦äº†è§£æ‰§è¡Œé¡ºåº


æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨ç½‘ç«™ä¸Šç™»å½•è´¦æˆ·ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦ç»è¿‡å¤šä¸ª"æ£€æŸ¥ç«™"ï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ ç¼–ç è¿‡æ»¤å™¨ â†’ ç™»å½•éªŒè¯è¿‡æ»¤å™¨ â†’ æƒé™æ£€æŸ¥è¿‡æ»¤å™¨ â†’ ç›®æ ‡é¡µé¢
```

å°±åƒæœºåœºå®‰æ£€ä¸€æ ·ï¼Œ**æ¯ä¸ªæ£€æŸ¥ç«™éƒ½æœ‰ç‰¹å®šçš„é¡ºåº**ï¼Œä¸èƒ½ä¹±æ¥ï¼å¦‚æœæƒé™æ£€æŸ¥åœ¨ç™»å½•éªŒè¯ä¹‹å‰ï¼Œé‚£å°±ä¼šå‡ºé—®é¢˜ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**
> 
> è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºå°±åƒ**æµæ°´çº¿ä½œä¸š**ï¼Œæ¯ä¸ªå·¥äººï¼ˆè¿‡æ»¤å™¨ï¼‰éƒ½è¦æŒ‰ç…§æ—¢å®šé¡ºåºå®Œæˆè‡ªå·±çš„å·¥ä½œï¼Œè¿™æ ·æ•´ä¸ªäº§å“ï¼ˆè¯·æ±‚ï¼‰æ‰èƒ½æ­£ç¡®å®Œæˆã€‚

### 1.2 æ‰§è¡Œé¡ºåºçš„å†³å®šå› ç´ 


**ğŸ”¸ åŸºäºweb.xmlé…ç½®é¡ºåº**
```xml
<!-- å…ˆé…ç½®çš„è¿‡æ»¤å™¨å…ˆæ‰§è¡Œ -->
<filter-mapping>
    <filter-name>CharacterEncodingFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>

<filter-mapping>
    <filter-name>LoginFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

**ğŸ”¸ åŸºäºæ³¨è§£çš„é¡ºåºï¼ˆä¸æ¨èç”¨äºå¤æ‚åœºæ™¯ï¼‰**

ä½¿ç”¨`@WebFilter`æ³¨è§£æ—¶ï¼Œæ‰§è¡Œé¡ºåº**ä¸ç¡®å®š**ï¼Œè¿™å°±åƒæ’é˜Ÿæ—¶æ²¡æœ‰å·ç ç‰Œï¼Œè°å…ˆåˆ°è°ååˆ°å…¨å‡­è¿æ°”ï¼

> âš ï¸ **æ–°æ‰‹æ³¨æ„**
> 
> å¦‚æœä½ çš„é¡¹ç›®éœ€è¦å¤šä¸ªè¿‡æ»¤å™¨æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œ**å¼ºçƒˆå»ºè®®ä½¿ç”¨web.xmlé…ç½®**ï¼Œå› ä¸ºé¡ºåºæ˜¯å¯æ§çš„ã€‚

### 1.3 æ‰§è¡Œé¡ºåºå¯è§†åŒ–å±•ç¤º


```
è¯·æ±‚æµå‘å›¾ï¼š
å®¢æˆ·ç«¯ â†’ Filter1 â†’ Filter2 â†’ Filter3 â†’ Servlet â†’ Filter3 â†’ Filter2 â†’ Filter1 â†’ å®¢æˆ·ç«¯
        â”‚        â”‚        â”‚               â”‚        â”‚        â”‚
        â”œâ”€beforeâ”€â”¤        â”‚               â”‚        â”œâ”€afterâ”€â”€â”¤
                 â”œâ”€beforeâ”€â”¤               â”œâ”€afterâ”€â”€â”¤
                          â”œâ”€beforeâ”€â”€â”€afterâ”€â”¤
```

**å…³é”®ç†è§£ï¼š**
- ğŸ“¥ **è¯·æ±‚è¿›å…¥æ—¶**ï¼šæŒ‰é…ç½®é¡ºåºæ‰§è¡Œï¼ˆ1â†’2â†’3ï¼‰
- ğŸ“¤ **å“åº”è¿”å›æ—¶**ï¼šæŒ‰ç›¸åé¡ºåºæ‰§è¡Œï¼ˆ3â†’2â†’1ï¼‰
- ğŸ”„ **å½¢æˆè°ƒç”¨æ ˆ**ï¼šæœ€åæ‰§è¡Œçš„è¿‡æ»¤å™¨æœ€å…ˆè¿”å›

---

## 2. âš™ï¸ FilterChainè°ƒç”¨æœºåˆ¶


### 2.1 FilterChainæ˜¯ä»€ä¹ˆ


æŠŠFilterChainæƒ³è±¡æˆä¸€æ¡**ä¼ é€å¸¦**ï¼Œæ¯ä¸ªè¿‡æ»¤å™¨éƒ½æ˜¯ä¼ é€å¸¦ä¸Šçš„ä¸€ä¸ª**å·¥ä½œç«™**ï¼š

```
FilterChainä¼ é€å¸¦ç¤ºæ„å›¾ï¼š

[è¯·æ±‚] â†’ å·¥ä½œç«™1 â†’ å·¥ä½œç«™2 â†’ å·¥ä½œç«™3 â†’ [ç›®æ ‡Servlet]
         â†“         â†“         â†“
      ç¼–ç å¤„ç†   ç™»å½•æ£€æŸ¥   æƒé™éªŒè¯
```

### 2.2 doFilter()æ–¹æ³•çš„ç¥å¥‡ä½œç”¨


`chain.doFilter(request, response)`å°±åƒæ˜¯è¯´ï¼š**"æˆ‘çš„å·¥ä½œåšå®Œäº†ï¼ŒæŠŠä»»åŠ¡ä¼ ç»™ä¸‹ä¸€ä¸ªå·¥ä½œç«™"**

```java
public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
    System.out.println("ğŸ“ ç¼–ç è¿‡æ»¤å™¨ï¼šå¼€å§‹å¤„ç†");
    
    // è®¾ç½®ç¼–ç æ ¼å¼
    request.setCharacterEncoding("UTF-8");
    response.setCharacterEncoding("UTF-8");
    
    System.out.println("ğŸ“¤ ç¼–ç è¿‡æ»¤å™¨ï¼šä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨");
    chain.doFilter(request, response); // ğŸ”¥ å…³é”®è°ƒç”¨ï¼
    
    System.out.println("ğŸ“ ç¼–ç è¿‡æ»¤å™¨ï¼šå¤„ç†è¿”å›ç»“æœ");
}
```

> ğŸ’¡ **å…³é”®ç†è§£**
> 
> - å¦‚æœ**ä¸è°ƒç”¨**`chain.doFilter()`ï¼Œè¯·æ±‚å°±**åˆ°æ­¤ä¸ºæ­¢**ï¼Œä¸ä¼šç»§ç»­ä¼ é€’
> - è¿™å°±åƒä¼ é€å¸¦çªç„¶åœæ­¢ï¼Œåé¢çš„å·¥ä½œç«™éƒ½æ”¶ä¸åˆ°ä»»åŠ¡

### 2.3 FilterChainæ‰§è¡Œæ—¶åºå›¾


```
æ—¶é—´çº¿ï¼š
   â”‚
   â”œâ”€ Filter1.doFilter() å¼€å§‹
   â”‚  â”œâ”€ æ‰§è¡Œå‰ç½®å¤„ç†
   â”‚  â”œâ”€ chain.doFilter() è°ƒç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  â”‚                              â”‚
   â”‚  â”‚  â”œâ”€ Filter2.doFilter() å¼€å§‹    â”‚
   â”‚  â”‚  â”œâ”€ æ‰§è¡Œå‰ç½®å¤„ç†               â”‚
   â”‚  â”‚  â”œâ”€ chain.doFilter() è°ƒç”¨ â”€â”€â”  â”‚
   â”‚  â”‚  â”‚                        â”‚  â”‚
   â”‚  â”‚  â”‚  â”œâ”€ Servlet.service()   â”‚  â”‚
   â”‚  â”‚  â”‚  â””â”€ Servlet å¤„ç†å®Œæˆ     â”‚  â”‚
   â”‚  â”‚  â”‚                        â”‚  â”‚
   â”‚  â”‚  â”œâ”€ æ‰§è¡Œåç½®å¤„ç† â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â”‚  â”‚  â””â”€ Filter2.doFilter() ç»“æŸ   â”‚
   â”‚  â”‚                              â”‚
   â”‚  â”œâ”€ æ‰§è¡Œåç½®å¤„ç† â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚  â””â”€ Filter1.doFilter() ç»“æŸ
   â”‚
   â–¼
```

### 2.4 å®é™…ä»£ç æ¼”ç¤º


```java
// ç¬¬ä¸€ä¸ªè¿‡æ»¤å™¨ï¼šç¼–ç è¿‡æ»¤å™¨
public class CharacterEncodingFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        System.out.println("ğŸ ç¼–ç è¿‡æ»¤å™¨ï¼šè¯·æ±‚è¿›å…¥");
        request.setCharacterEncoding("UTF-8");
        
        chain.doFilter(request, response);
        
        System.out.println("ğŸ ç¼–ç è¿‡æ»¤å™¨ï¼šå“åº”è¿”å›");
    }
}

// ç¬¬äºŒä¸ªè¿‡æ»¤å™¨ï¼šç™»å½•è¿‡æ»¤å™¨
public class LoginFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        System.out.println("ğŸ” ç™»å½•è¿‡æ»¤å™¨ï¼šè¯·æ±‚è¿›å…¥");
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
        if (ç”¨æˆ·å·²ç™»å½•) {
            chain.doFilter(request, response);
        } else {
            // é‡å®šå‘åˆ°ç™»å½•é¡µé¢
            ((HttpServletResponse)response).sendRedirect("/login.jsp");
        }
        
        System.out.println("ğŸ” ç™»å½•è¿‡æ»¤å™¨ï¼šå“åº”è¿”å›");
    }
}
```

**è¿è¡Œç»“æœç¤ºä¾‹ï¼š**
```
ğŸ ç¼–ç è¿‡æ»¤å™¨ï¼šè¯·æ±‚è¿›å…¥
ğŸ” ç™»å½•è¿‡æ»¤å™¨ï¼šè¯·æ±‚è¿›å…¥
ğŸ” ç™»å½•è¿‡æ»¤å™¨ï¼šå“åº”è¿”å›
ğŸ ç¼–ç è¿‡æ»¤å™¨ï¼šå“åº”è¿”å›
```

---

## 3. ğŸ“¨ REQUESTè¯·æ±‚è°ƒåº¦


### 3.1 ä»€ä¹ˆæ˜¯REQUESTè°ƒåº¦


REQUESTè°ƒåº¦æ˜¯æœ€**å¸¸è§**çš„è°ƒåº¦æ–¹å¼ï¼Œå°±åƒä½ ç›´æ¥è®¿é—®ä¸€ä¸ªç½‘é¡µï¼š

```
æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼šhttp://localhost:8080/user/profile
                                    â†“
                            è¿™å°±æ˜¯REQUESTè°ƒåº¦ï¼
```

### 3.2 REQUESTè°ƒåº¦çš„é…ç½®æ–¹å¼


**æ–¹æ³•ä¸€ï¼šweb.xmlé…ç½®**
```xml
<filter-mapping>
    <filter-name>MyFilter</filter-name>
    <url-pattern>/user/*</url-pattern>
    <!-- é»˜è®¤å°±æ˜¯REQUESTï¼Œå¯ä»¥ä¸å†™ -->
    <dispatcher>REQUEST</dispatcher>
</filter-mapping>
```

**æ–¹æ³•äºŒï¼šæ³¨è§£é…ç½®**
```java
@WebFilter(
    urlPatterns = "/user/*",
    dispatcherTypes = {DispatcherType.REQUEST}
)
public class MyFilter implements Filter {
    // è¿‡æ»¤å™¨å®ç°
}
```

### 3.3 REQUESTè°ƒåº¦çš„æ‰§è¡Œæµç¨‹


```
REQUESTè°ƒåº¦æ‰§è¡Œæµç¨‹ï¼š

å®¢æˆ·ç«¯æµè§ˆå™¨
    â”‚
    â”‚ HTTPè¯·æ±‚
    â–¼
Webå®¹å™¨æ¥æ”¶
    â”‚
    â–¼
ğŸ“‹ æ£€æŸ¥è¿‡æ»¤å™¨é…ç½®
    â”‚
    â–¼
ğŸ” åŒ¹é…URLæ¨¡å¼
    â”‚
    â–¼ 
âœ… æ‰§è¡Œè¿‡æ»¤å™¨é“¾
    â”‚
    â–¼
ğŸ¯ è°ƒç”¨ç›®æ ‡Servlet
    â”‚
    â–¼
ğŸ“¤ è¿”å›å“åº”
```

### 3.4 å®é™…ä½¿ç”¨åœºæ™¯


| ä½¿ç”¨åœºæ™¯ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| **ç”¨æˆ·è®¤è¯** | æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½• | `/admin/*`é¡µé¢éœ€è¦ç™»å½• |
| **ç¼–ç è®¾ç½®** | ç»Ÿä¸€è®¾ç½®å­—ç¬¦ç¼–ç  | æ‰€æœ‰è¯·æ±‚è®¾ç½®UTF-8 |
| **è®¿é—®æ—¥å¿—** | è®°å½•ç”¨æˆ·è®¿é—®ä¿¡æ¯ | è®°å½•IPã€è®¿é—®æ—¶é—´ç­‰ |
| **è·¨åŸŸå¤„ç†** | æ·»åŠ CORSå¤´ä¿¡æ¯ | APIæ¥å£è·¨åŸŸæ”¯æŒ |

**ğŸ”¸ ç¼–ç è¿‡æ»¤å™¨ç¤ºä¾‹**
```java
@WebFilter("/*") // æ‹¦æˆªæ‰€æœ‰REQUESTè¯·æ±‚
public class EncodingFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        // ğŸ› ï¸ å‰ç½®å¤„ç†ï¼šè®¾ç½®ç¼–ç 
        request.setCharacterEncoding("UTF-8");
        response.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        
        System.out.println("ğŸŒ REQUESTè°ƒåº¦ï¼šå¤„ç†URL = " + 
            ((HttpServletRequest)request).getRequestURI());
        
        chain.doFilter(request, response);
        
        // ğŸ› ï¸ åç½®å¤„ç†ï¼ˆå¦‚éœ€è¦ï¼‰
        System.out.println("âœ… REQUESTè°ƒåº¦ï¼šå“åº”å¤„ç†å®Œæˆ");
    }
}
```

---

## 4. â¡ï¸ FORWARDè½¬å‘è°ƒåº¦


### 4.1 ä»€ä¹ˆæ˜¯FORWARDè½¬å‘


FORWARDè½¬å‘å°±åƒ**å†…éƒ¨è½¬æ¥ç”µè¯**ï¼š

```
ç”¨æˆ·æ‹¨æ‰“æ€»æœº â†’ æ€»æœºå†…éƒ¨è½¬æ¥åˆ°å…·ä½“éƒ¨é—¨ â†’ ç”¨æˆ·ä¸çŸ¥é“å†…éƒ¨è½¬æ¥è¿‡ç¨‹

å®¢æˆ·ç«¯è¯·æ±‚ â†’ Servletå†…éƒ¨è½¬å‘ â†’ å¦ä¸€ä¸ªServletå¤„ç† â†’ å®¢æˆ·ç«¯çœ‹åˆ°æœ€ç»ˆç»“æœ
           â†‘                                  
        åœ°å€æ ä¸å˜ï¼
```

> ğŸ’¡ **ç”Ÿæ´»æ¯”å–»**
> 
> å°±åƒä½ å»é“¶è¡ŒåŠä¸šåŠ¡ï¼ŒæŸœå‘˜å‘ç°ä½ çš„ä¸šåŠ¡éœ€è¦ç»ç†å¤„ç†ï¼Œäºæ˜¯å«æ¥ç»ç†å¸®ä½ åŠç†ï¼Œä½†ä½ å§‹ç»ˆååœ¨åŒä¸€ä¸ªä½ç½®ï¼Œè¿™å°±æ˜¯è½¬å‘ï¼

### 4.2 è½¬å‘ä¸é‡å®šå‘çš„åŒºåˆ«


| å¯¹æ¯”é¡¹ç›® | **FORWARDè½¬å‘** | **REDIRECTé‡å®šå‘** |
|---------|----------------|-------------------|
| **åœ°å€æ ** | `ğŸ”’ ä¸å˜` | `ğŸ”„ ä¼šå˜` |
| **è¯·æ±‚æ¬¡æ•°** | `1ï¸âƒ£ ä¸€æ¬¡` | `2ï¸âƒ£ ä¸¤æ¬¡` |
| **æ•°æ®å…±äº«** | `âœ… å¯ä»¥å…±äº«` | `âŒ ä¸èƒ½å…±äº«` |
| **é€Ÿåº¦** | `âš¡ å¿«` | `ğŸŒ æ…¢` |
| **ä½¿ç”¨åœºæ™¯** | `å†…éƒ¨è·³è½¬` | `å¤–éƒ¨è·³è½¬` |

### 4.3 FORWARDè°ƒåº¦é…ç½®


```xml
<filter-mapping>
    <filter-name>ForwardFilter</filter-name>
    <url-pattern>/admin/*</url-pattern>
    <dispatcher>FORWARD</dispatcher>
</filter-mapping>
```

### 4.4 FORWARDè°ƒåº¦å®é™…åº”ç”¨


**ğŸ”¸ åœºæ™¯ï¼šç”¨æˆ·ç™»å½•å¤„ç†**

```java
// LoginServlet.java
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) {
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        
        if (éªŒè¯æˆåŠŸ) {
            // ğŸ¯ è½¬å‘åˆ°æˆåŠŸé¡µé¢
            request.setAttribute("user", user);
            request.getRequestDispatcher("/WEB-INF/success.jsp")
                   .forward(request, response);
        } else {
            // ğŸ¯ è½¬å‘åˆ°å¤±è´¥é¡µé¢  
            request.setAttribute("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            request.getRequestDispatcher("/WEB-INF/login.jsp")
                   .forward(request, response);
        }
    }
}

// ForwardFilter.java - ä¸“é—¨å¤„ç†è½¬å‘è¯·æ±‚
@WebFilter(
    urlPatterns = "/WEB-INF/*",
    dispatcherTypes = {DispatcherType.FORWARD}
)
public class ForwardFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        System.out.println("ğŸ”„ FORWARDè°ƒåº¦ï¼šå†…éƒ¨è½¬å‘å¤„ç†");
        
        // å¯ä»¥åœ¨è½¬å‘å‰åæ·»åŠ é¢å¤–å¤„ç†é€»è¾‘
        HttpServletRequest req = (HttpServletRequest) request;
        System.out.println("ğŸ“ è½¬å‘ç›®æ ‡ï¼š" + req.getRequestURI());
        
        chain.doFilter(request, response);
    }
}
```

### 4.5 è½¬å‘è°ƒåº¦æ‰§è¡Œæµç¨‹å›¾


```
FORWARDè°ƒåº¦æµç¨‹ï¼š

å®¢æˆ·ç«¯
  â”‚
  â”‚ 1. POST /login
  â–¼
LoginServlet
  â”‚
  â”‚ 2. å¤„ç†ç™»å½•é€»è¾‘
  â–¼
éªŒè¯ç»“æœï¼Ÿ
  â”‚
  â”œâ”€æˆåŠŸâ”€â†’ forward("/success.jsp")
  â”‚           â”‚
  â”‚           â–¼
  â”‚        ğŸ”„ FORWARDè°ƒåº¦è§¦å‘
  â”‚           â”‚
  â”‚           â–¼
  â”‚        ForwardFilteræ‰§è¡Œ
  â”‚           â”‚
  â”‚           â–¼
  â”‚        success.jspæ˜¾ç¤º
  â”‚
  â””â”€å¤±è´¥â”€â†’ forward("/login.jsp") 
             â”‚
             â–¼
          ğŸ”„ FORWARDè°ƒåº¦è§¦å‘
             â”‚
             â–¼
          ForwardFilteræ‰§è¡Œ
             â”‚
             â–¼
          login.jspæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
```

---

## 5. ğŸ“„ INCLUDEåŒ…å«è°ƒåº¦


### 5.1 ä»€ä¹ˆæ˜¯INCLUDEåŒ…å«


INCLUDEåŒ…å«å°±åƒ**æ‹¼ç§¯æœ¨**ï¼ŒæŠŠå¤šä¸ªå°é¡µé¢ç»„è£…æˆä¸€ä¸ªå®Œæ•´é¡µé¢ï¼š

```
ä¸»é¡µé¢å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å¤´éƒ¨å¯¼èˆª        â”‚  â† include header.jsp
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    â”‚
â”‚      ä¸»è¦å†…å®¹        â”‚  â† å½“å‰é¡µé¢å†…å®¹
â”‚                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      åº•éƒ¨ä¿¡æ¯        â”‚  â† include footer.jsp
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **ç”Ÿæ´»æ¯”å–»**
> 
> å°±åƒåšèœæ—¶ï¼Œä¸»èœæ˜¯ç‰›æ’ï¼Œä½†ä½ è¿˜è¦é…ç‚¹é…èœï¼ˆæ²™æ‹‰ã€æ±¤ï¼‰ï¼Œæœ€åç»„è£…æˆä¸€ä»½å®Œæ•´çš„å¥—é¤ã€‚æ¯ä¸ªé…èœéƒ½æ˜¯ç‹¬ç«‹å‡†å¤‡çš„ï¼Œä½†æœ€ç»ˆç»„åˆåœ¨ä¸€èµ·ã€‚

### 5.2 INCLUDEä¸FORWARDçš„åŒºåˆ«


| å¯¹æ¯”é¡¹ç›® | **INCLUDEåŒ…å«** | **FORWARDè½¬å‘** |
|---------|----------------|----------------|
| **æ§åˆ¶æƒ** | `ğŸ”„ ä¼šå›åˆ°è°ƒç”¨è€…` | `â¡ï¸ è½¬ç§»ç»™ç›®æ ‡` |
| **å“åº”å¤„ç†** | `ğŸ“ å¯ä»¥ç»„åˆå¤šä¸ªå“åº”` | `ğŸ¯ åªæœ‰ä¸€ä¸ªå“åº”` |
| **ä½¿ç”¨åœºæ™¯** | `ğŸ§© é¡µé¢ç»„è£…` | `ğŸ“„ é¡µé¢è·³è½¬` |
| **æ•°æ®å¤„ç†** | `âœ… ç´¯ç§¯å¤„ç†` | `ğŸ”„ æ›¿æ¢å¤„ç†` |

### 5.3 INCLUDEè°ƒåº¦é…ç½®


```xml
<filter-mapping>
    <filter-name>IncludeFilter</filter-name>
    <url-pattern>/components/*</url-pattern>
    <dispatcher>INCLUDE</dispatcher>
</filter-mapping>
```

### 5.4 å®é™…åº”ç”¨ç¤ºä¾‹


**ğŸ”¸ ç½‘ç«™å¸ƒå±€æ¨¡å—åŒ–**

```java
// ä¸»é¡µé¢ main.jsp
<%
    // åŒ…å«å¤´éƒ¨
    request.getRequestDispatcher("/components/header.jsp")
           .include(request, response);
    
    // åŒ…å«ä¾§è¾¹æ 
    request.getRequestDispatcher("/components/sidebar.jsp")
           .include(request, response);
    
    // åŒ…å«åº•éƒ¨
    request.getRequestDispatcher("/components/footer.jsp")
           .include(request, response);
%>

// IncludeFilter.java - å¤„ç†åŒ…å«è°ƒåº¦
@WebFilter(
    urlPatterns = "/components/*",
    dispatcherTypes = {DispatcherType.INCLUDE}
)
public class IncludeFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        System.out.println("ğŸ§© INCLUDEè°ƒåº¦ï¼šç»„è£…é¡µé¢ç»„ä»¶");
        
        HttpServletRequest req = (HttpServletRequest) request;
        String componentName = req.getRequestURI();
        
        System.out.println("ğŸ“¦ åŒ…å«ç»„ä»¶ï¼š" + componentName);
        
        // å¯ä»¥å¯¹åŒ…å«çš„ç»„ä»¶è¿›è¡Œé¢„å¤„ç†
        if (componentName.contains("header")) {
            request.setAttribute("pageTitle", "ç½‘ç«™é¦–é¡µ");
        }
        
        chain.doFilter(request, response);
        
        System.out.println("âœ… ç»„ä»¶åŒ…å«å®Œæˆï¼š" + componentName);
    }
}
```

### 5.5 INCLUDEè°ƒåº¦æ‰§è¡Œæµç¨‹


```
INCLUDEè°ƒåº¦æ‰§è¡Œæ—¶åºï¼š

ä¸»é¡µé¢ main.jsp
    â”‚
    â”‚ 1. å¼€å§‹æ¸²æŸ“
    â–¼
include header.jsp
    â”‚
    â”‚ ğŸ§© è§¦å‘INCLUDEè°ƒåº¦
    â–¼
IncludeFilterå¤„ç†
    â”‚
    â–¼
header.jspæ‰§è¡Œ
    â”‚ (æ¸²æŸ“å¤´éƒ¨HTML)
    â–¼
è¿”å›ä¸»é¡µé¢
    â”‚
    â”‚ 2. ç»§ç»­æ¸²æŸ“ä¸»å†…å®¹
    â–¼
include sidebar.jsp
    â”‚
    â”‚ ğŸ§© è§¦å‘INCLUDEè°ƒåº¦
    â–¼
IncludeFilterå¤„ç†
    â”‚
    â–¼
sidebar.jspæ‰§è¡Œ
    â”‚ (æ¸²æŸ“ä¾§è¾¹æ HTML)
    â–¼
è¿”å›ä¸»é¡µé¢
    â”‚
    â”‚ 3. å®Œæˆæ¸²æŸ“
    â–¼
å®Œæ•´é¡µé¢è¾“å‡ºç»™å®¢æˆ·ç«¯
```

---

## 6. âŒ ERRORé”™è¯¯è°ƒåº¦


### 6.1 ä»€ä¹ˆæ˜¯ERRORé”™è¯¯è°ƒåº¦


ERRORè°ƒåº¦å°±åƒ**åº”æ€¥é¢„æ¡ˆ**ï¼Œå½“ç½‘ç«™å‡ºç°é”™è¯¯æ—¶ï¼Œè‡ªåŠ¨è·³è½¬åˆ°é”™è¯¯å¤„ç†é¡µé¢ï¼š

```
æ­£å¸¸è®¿é—®ï¼šç”¨æˆ· â†’ æ­£å¸¸é¡µé¢ â†’ æ˜¾ç¤ºå†…å®¹
å‡ºç°é”™è¯¯ï¼šç”¨æˆ· â†’ å‘ç”Ÿé”™è¯¯ â†’ é”™è¯¯é¡µé¢ â†’ å‹å¥½æç¤º

å°±åƒç”µæ¢¯åäº†ï¼Œä¼šè‡ªåŠ¨æ˜¾ç¤º"ç”µæ¢¯æ•…éšœï¼Œè¯·èµ°æ¥¼æ¢¯"çš„æç¤ºç‰Œ
```

### 6.2 é”™è¯¯ç±»å‹ä¸çŠ¶æ€ç 


| HTTPçŠ¶æ€ç  | é”™è¯¯ç±»å‹ | å¸¸è§åŸå›  | ç”¨æˆ·çœ‹åˆ°çš„ç°è±¡ |
|-----------|---------|---------|---------------|
| **404** | `ğŸ” é¡µé¢æœªæ‰¾åˆ°` | URLé”™è¯¯ã€é¡µé¢ä¸å­˜åœ¨ | "æ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨" |
| **500** | `ğŸ’¥ æœåŠ¡å™¨å†…éƒ¨é”™è¯¯` | ä»£ç å¼‚å¸¸ã€æ•°æ®åº“è¿æ¥å¤±è´¥ | "æœåŠ¡å™¨å¼€å°å·®äº†" |
| **403** | `ğŸš« ç¦æ­¢è®¿é—®` | æƒé™ä¸è¶³ | "æ‚¨æ²¡æœ‰è®¿é—®æƒé™" |
| **401** | `ğŸ” æœªæˆæƒ` | æœªç™»å½• | "è¯·å…ˆç™»å½•" |

### 6.3 ERRORè°ƒåº¦é…ç½®


**ğŸ”¸ web.xmlé…ç½®**
```xml
<!-- é…ç½®é”™è¯¯é¡µé¢ -->
<error-page>
    <error-code>404</error-code>
    <location>/error/404.jsp</location>
</error-page>

<error-page>
    <error-code>500</error-code>
    <location>/error/500.jsp</location>
</error-page>

<!-- é…ç½®ERRORè°ƒåº¦è¿‡æ»¤å™¨ -->
<filter-mapping>
    <filter-name>ErrorFilter</filter-name>
    <url-pattern>/error/*</url-pattern>
    <dispatcher>ERROR</dispatcher>
</filter-mapping>
```

### 6.4 ERRORè°ƒåº¦å®é™…åº”ç”¨


```java
@WebFilter(
    urlPatterns = "/error/*",
    dispatcherTypes = {DispatcherType.ERROR}
)
public class ErrorFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        System.out.println("âŒ ERRORè°ƒåº¦ï¼šå¤„ç†é”™è¯¯é¡µé¢");
        
        HttpServletRequest req = (HttpServletRequest) request;
        
        // è·å–é”™è¯¯ä¿¡æ¯
        Integer statusCode = (Integer) req.getAttribute("javax.servlet.error.status_code");
        String errorMessage = (String) req.getAttribute("javax.servlet.error.message");
        Exception exception = (Exception) req.getAttribute("javax.servlet.error.exception");
        
        System.out.println("ğŸš¨ é”™è¯¯çŠ¶æ€ç ï¼š" + statusCode);
        System.out.println("ğŸ“ é”™è¯¯ä¿¡æ¯ï¼š" + errorMessage);
        
        // è®°å½•é”™è¯¯æ—¥å¿—
        logError(statusCode, errorMessage, exception);
        
        // å¯ä»¥æ ¹æ®é”™è¯¯ç±»å‹åšä¸åŒå¤„ç†
        if (statusCode != null) {
            switch (statusCode) {
                case 404:
                    System.out.println("ğŸ” é¡µé¢æœªæ‰¾åˆ°é”™è¯¯");
                    break;
                case 500:
                    System.out.println("ğŸ’¥ æœåŠ¡å™¨å†…éƒ¨é”™è¯¯");
                    break;
                default:
                    System.out.println("â“ å…¶ä»–é”™è¯¯ï¼š" + statusCode);
            }
        }
        
        chain.doFilter(request, response);
    }
    
    private void logError(Integer statusCode, String errorMessage, Exception exception) {
        // è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶æˆ–æ•°æ®åº“
        String logEntry = String.format("[%s] é”™è¯¯ç :%d, ä¿¡æ¯:%s", 
            new Date(), statusCode, errorMessage);
        System.out.println("ğŸ“‹ é”™è¯¯æ—¥å¿—ï¼š" + logEntry);
    }
}
```

### 6.5 é”™è¯¯å¤„ç†æµç¨‹å›¾


```
ERRORè°ƒåº¦å¤„ç†æµç¨‹ï¼š

ç”¨æˆ·è®¿é—®é¡µé¢
    â”‚
    â–¼
Servletå¤„ç†è¯·æ±‚
    â”‚
    â”œâ”€ æ­£å¸¸ â”€â†’ è¿”å›æ­£å¸¸é¡µé¢
    â”‚
    â””â”€ å¼‚å¸¸ â”€â”
             â”‚
             â–¼
        æŠ›å‡ºå¼‚å¸¸/é”™è¯¯çŠ¶æ€ç 
             â”‚
             â–¼
        Webå®¹å™¨æ•è·é”™è¯¯
             â”‚
             â–¼
        æŸ¥æ‰¾error-pageé…ç½®
             â”‚
             â–¼ 
        ğŸš¨ è§¦å‘ERRORè°ƒåº¦
             â”‚
             â–¼
        ErrorFilteræ‰§è¡Œ
             â”‚
             â–¼
        æ˜¾ç¤ºå‹å¥½é”™è¯¯é¡µé¢
             â”‚
             â–¼
        ç”¨æˆ·çœ‹åˆ°é”™è¯¯æç¤º
```

**ğŸ”¸ å‹å¥½çš„404é”™è¯¯é¡µé¢ç¤ºä¾‹**
```jsp
<%-- 404.jsp --%>
<!DOCTYPE html>
<html>
<head>
    <title>é¡µé¢æœªæ‰¾åˆ°</title>
    <style>
        .error-container {
            text-align: center;
            padding: 100px;
        }
        .error-code {
            font-size: 72px;
            color: #ff6b6b;
            font-weight: bold;
        }
        .error-message {
            font-size: 24px;
            color: #666;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="error-code">404</div>
        <div class="error-message">å“å‘€ï¼æ‚¨è®¿é—®çš„é¡µé¢èµ°ä¸¢äº† ğŸ”</div>
        <p>å¯èƒ½æ˜¯é¡µé¢åœ°å€è¾“å…¥é”™è¯¯ï¼Œæˆ–è€…é¡µé¢å·²ç»ä¸å­˜åœ¨äº†</p>
        <a href="/">è¿”å›é¦–é¡µ</a>
    </div>
</body>
</html>
```

---

## 7. ğŸš€ ASYNCå¼‚æ­¥è°ƒåº¦


### 7.1 ä»€ä¹ˆæ˜¯ASYNCå¼‚æ­¥è°ƒåº¦


å¼‚æ­¥è°ƒåº¦å°±åƒ**å¤–å–è®¢é¤**ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆåŒæ­¥ï¼‰ï¼š
ä½ å»é¤å… â†’ ç‚¹é¤ â†’ åç€ç­‰ â†’ èœåšå¥½ â†’ åƒé¥­ â†’ ç¦»å¼€
ï¼ˆæ•´ä¸ªè¿‡ç¨‹ä½ éƒ½åœ¨é¤å…ç­‰å¾…ï¼‰

å¼‚æ­¥æ–¹å¼ï¼š
ä½ ç‚¹å¤–å– â†’ ç»§ç»­å·¥ä½œ â†’ å¤–å–åšå¥½åé€šçŸ¥ä½  â†’ æ”¶å¤–å–
ï¼ˆä½ ä¸éœ€è¦ä¸€ç›´ç­‰å¾…ï¼Œå¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼‰
```

åœ¨Webåº”ç”¨ä¸­ï¼š
- **åŒæ­¥è¯·æ±‚**ï¼šæµè§ˆå™¨å‘é€è¯·æ±‚åä¸€ç›´ç­‰å¾…å“åº”
- **å¼‚æ­¥è¯·æ±‚**ï¼šè¯·æ±‚å‘å‡ºåç«‹å³è¿”å›ï¼Œåå°ç»§ç»­å¤„ç†ï¼Œå®Œæˆåé€šçŸ¥å®¢æˆ·ç«¯

### 7.2 å¼‚æ­¥å¤„ç†çš„åº”ç”¨åœºæ™¯


| ä½¿ç”¨åœºæ™¯ | åŒæ­¥é—®é¢˜ | å¼‚æ­¥ä¼˜åŠ¿ |
|---------|---------|---------|
| **æ–‡ä»¶ä¸Šä¼ ** | `â° å¤§æ–‡ä»¶ä¸Šä¼ æ—¶é¡µé¢å¡æ­»` | `ğŸ”„ åå°ä¸Šä¼ ï¼Œå®æ—¶æ˜¾ç¤ºè¿›åº¦` |
| **é‚®ä»¶å‘é€** | `ğŸ“§ å‘é€é‚®ä»¶æ—¶ç”¨æˆ·ç­‰å¾…` | `âœ… ç«‹å³è¿”å›ï¼Œåå°å‘é€` |
| **æ•°æ®å¯¼å…¥** | `ğŸ“Š å¯¼å…¥å¤§é‡æ•°æ®æ—¶è¶…æ—¶` | `âš¡ å¼‚æ­¥å¯¼å…¥ï¼Œå®šæ—¶æŸ¥è¯¢è¿›åº¦` |
| **å›¾ç‰‡å¤„ç†** | `ğŸ–¼ï¸ å¤„ç†å›¾ç‰‡æ—¶é¡µé¢æ— å“åº”` | `ğŸ¨ åå°å¤„ç†ï¼Œå®Œæˆåé€šçŸ¥` |

### 7.3 ASYNCè°ƒåº¦é…ç½®


**ğŸ”¸ å¯ç”¨å¼‚æ­¥æ”¯æŒ**
```xml
<!-- Servleté…ç½®å¼‚æ­¥æ”¯æŒ -->
<servlet>
    <servlet-name>AsyncServlet</servlet-name>
    <servlet-class>com.example.AsyncServlet</servlet-class>
    <async-supported>true</async-supported>
</servlet>

<!-- Filteré…ç½®å¼‚æ­¥è°ƒåº¦ -->
<filter-mapping>
    <filter-name>AsyncFilter</filter-name>
    <url-pattern>/async/*</url-pattern>
    <dispatcher>ASYNC</dispatcher>
</filter-mapping>
```

**ğŸ”¸ æ³¨è§£æ–¹å¼é…ç½®**
```java
@WebServlet(value = "/async/*", asyncSupported = true)
public class AsyncServlet extends HttpServlet {
    // Servletæ”¯æŒå¼‚æ­¥
}

@WebFilter(
    urlPatterns = "/async/*",
    dispatcherTypes = {DispatcherType.ASYNC},
    asyncSupported = true
)
public class AsyncFilter implements Filter {
    // è¿‡æ»¤å™¨æ”¯æŒå¼‚æ­¥
}
```

### 7.4 å¼‚æ­¥å¤„ç†å®é™…åº”ç”¨


**ğŸ”¸ å¼‚æ­¥æ–‡ä»¶ä¸Šä¼ ç¤ºä¾‹**

```java
@WebServlet(value = "/upload", asyncSupported = true)
public class AsyncUploadServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) {
        System.out.println("ğŸ“¤ å¼€å§‹å¼‚æ­¥æ–‡ä»¶ä¸Šä¼ ");
        
        // ğŸš€ å¯åŠ¨å¼‚æ­¥å¤„ç†
        AsyncContext asyncContext = request.startAsync();
        asyncContext.setTimeout(30000); // 30ç§’è¶…æ—¶
        
        // åœ¨æ–°çº¿ç¨‹ä¸­å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        asyncContext.start(() -> {
            try {
                System.out.println("ğŸ”„ åå°å¤„ç†æ–‡ä»¶ä¸Šä¼ ...");
                
                // æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†è¿‡ç¨‹
                Thread.sleep(10000); // æ¨¡æ‹Ÿ10ç§’çš„å¤„ç†æ—¶é—´
                
                // å¤„ç†å®Œæˆï¼Œè¿”å›ç»“æœ
                HttpServletResponse asyncResponse = (HttpServletResponse) asyncContext.getResponse();
                asyncResponse.getWriter().write("âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼");
                
                System.out.println("âœ… å¼‚æ­¥å¤„ç†å®Œæˆ");
                asyncContext.complete(); // å®Œæˆå¼‚æ­¥å¤„ç†
                
            } catch (Exception e) {
                System.out.println("âŒ å¼‚æ­¥å¤„ç†å‡ºé”™ï¼š" + e.getMessage());
                asyncContext.complete();
            }
        });
        
        System.out.println("ğŸ“‹ å¼‚æ­¥ä»»åŠ¡å·²å¯åŠ¨ï¼Œè¯·æ±‚ç«‹å³è¿”å›");
        // æ³¨æ„ï¼šè¿™é‡Œä¸èƒ½å†™å…¥responseï¼Œå› ä¸ºå¼‚æ­¥å¤„ç†è¿˜åœ¨è¿›è¡Œ
    }
}

// ASYNCè°ƒåº¦è¿‡æ»¤å™¨
@WebFilter(
    urlPatterns = "/upload",
    dispatcherTypes = {DispatcherType.ASYNC},
    asyncSupported = true
)
public class AsyncFilter implements Filter {
    
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        System.out.println("ğŸš€ ASYNCè°ƒåº¦ï¼šå¼‚æ­¥è¯·æ±‚å¤„ç†");
        
        HttpServletRequest req = (HttpServletRequest) request;
        AsyncContext asyncContext = req.getAsyncContext();
        
        if (asyncContext != null) {
            System.out.println("â° å¼‚æ­¥è¶…æ—¶æ—¶é—´ï¼š" + asyncContext.getTimeout() + "ms");
            
            // å¯ä»¥æ·»åŠ å¼‚æ­¥ç›‘å¬å™¨
            asyncContext.addListener(new AsyncListener() {
                public void onComplete(AsyncEvent event) {
                    System.out.println("âœ… å¼‚æ­¥å¤„ç†å®Œæˆ");
                }
                
                public void onTimeout(AsyncEvent event) {
                    System.out.println("â° å¼‚æ­¥å¤„ç†è¶…æ—¶");
                }
                
                public void onError(AsyncEvent event) {
                    System.out.println("âŒ å¼‚æ­¥å¤„ç†å‡ºé”™");
                }
                
                public void onStartAsync(AsyncEvent event) {
                    System.out.println("ğŸš€ å¼‚æ­¥å¤„ç†å¼€å§‹");
                }
            });
        }
        
        chain.doFilter(request, response);
    }
}
```

### 7.5 å¼‚æ­¥è°ƒåº¦æ‰§è¡Œæµç¨‹


```
ASYNCå¼‚æ­¥è°ƒåº¦æ‰§è¡Œæ—¶åºï¼š

å®¢æˆ·ç«¯
  â”‚
  â”‚ 1. POST /upload (ä¸Šä¼ æ–‡ä»¶)
  â–¼
AsyncUploadServlet
  â”‚
  â”‚ 2. å¯åŠ¨å¼‚æ­¥ä¸Šä¸‹æ–‡
  â–¼
request.startAsync()
  â”‚
  â”‚ 3. ç«‹å³è¿”å›å“åº”ç»™å®¢æˆ·ç«¯
  â”‚ ï¼ˆå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ…ï¼‰
  â–¼
å¼‚æ­¥ä»»åŠ¡åœ¨åå°æ‰§è¡Œ
  â”‚
  â”‚ ğŸš€ è§¦å‘ASYNCè°ƒåº¦
  â–¼
AsyncFilteræ‰§è¡Œ
  â”‚
  â”‚ 4. ç›‘æ§å¼‚æ­¥å¤„ç†è¿‡ç¨‹
  â–¼
åå°æ–‡ä»¶å¤„ç†çº¿ç¨‹
  â”‚
  â”‚ 5. å®é™…å¤„ç†æ–‡ä»¶
  â”‚ ï¼ˆ10ç§’å¤„ç†æ—¶é—´ï¼‰
  â–¼
å¤„ç†å®Œæˆ
  â”‚
  â”‚ 6. è°ƒç”¨asyncContext.complete()
  â–¼ 
é€šçŸ¥å®¢æˆ·ç«¯å¤„ç†ç»“æœ
```

### 7.6 å¼‚æ­¥å¤„ç†çš„æ³¨æ„äº‹é¡¹


> âš ï¸ **é‡è¦æé†’**
> 
> 1. **å¿…é¡»è®¾ç½®`asyncSupported=true`**ï¼šServletå’ŒFilteréƒ½éœ€è¦
> 2. **è¶…æ—¶æ—¶é—´è®¾ç½®**ï¼šé¿å…å¼‚æ­¥ä»»åŠ¡æ— é™ç­‰å¾…
> 3. **å¼‚å¸¸å¤„ç†**ï¼šå¼‚æ­¥çº¿ç¨‹ä¸­çš„å¼‚å¸¸éœ€è¦ç‰¹åˆ«å¤„ç†
> 4. **èµ„æºç®¡ç†**ï¼šåŠæ—¶è°ƒç”¨`complete()`é‡Šæ”¾èµ„æº

**ğŸ”¸ å¼‚æ­¥å¤„ç†æœ€ä½³å®è·µ**
```java
// ä½¿ç”¨çº¿ç¨‹æ± ç®¡ç†å¼‚æ­¥ä»»åŠ¡
private ExecutorService executor = Executors.newFixedThreadPool(10);

protected void doPost(HttpServletRequest request, HttpServletResponse response) {
    AsyncContext asyncContext = request.startAsync();
    asyncContext.setTimeout(60000); // 60ç§’è¶…æ—¶
    
    // æäº¤åˆ°çº¿ç¨‹æ± å¤„ç†ï¼Œé¿å…æ— é™åˆ›å»ºçº¿ç¨‹
    executor.submit(() -> {
        try {
            // å®é™…ä¸šåŠ¡å¤„ç†
            processBusinessLogic(asyncContext);
        } catch (Exception e) {
            handleAsyncError(asyncContext, e);
        } finally {
            asyncContext.complete(); // ç¡®ä¿é‡Šæ”¾èµ„æº
        }
    });
}
```

---

## 8. ğŸ¯ å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ


### 8.1 å¤šè°ƒåº¦ç±»å‹ç»„åˆä½¿ç”¨


åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€šå¸¸éœ€è¦**ç»„åˆä½¿ç”¨**å¤šç§è°ƒåº¦ç±»å‹ï¼š

```xml
<!-- ç»¼åˆæ€§çš„å®‰å…¨è¿‡æ»¤å™¨ -->
<filter-mapping>
    <filter-name>SecurityFilter</filter-name>
    <url-pattern>/admin/*</url-pattern>
    <!-- æ”¯æŒå¤šç§è°ƒåº¦ç±»å‹ -->
    <dispatcher>REQUEST</dispatcher>
    <dispatcher>FORWARD</dispatcher>
    <dispatcher>ERROR</dispatcher>
</filter-mapping>
```

**ğŸ”¸ å®é™…åº”ç”¨åœºæ™¯è¡¨æ ¼**

| è¿‡æ»¤å™¨ç±»å‹ | REQUEST | FORWARD | INCLUDE | ERROR | ASYNC |
|-----------|---------|---------|---------|-------|-------|
| **ç¼–ç è¿‡æ»¤å™¨** | `âœ…` | `âœ…` | `âœ…` | `âŒ` | `âœ…` |
| **ç™»å½•éªŒè¯** | `âœ…` | `âœ…` | `âŒ` | `âŒ` | `âœ…` |
| **æƒé™æ£€æŸ¥** | `âœ…` | `âœ…` | `âŒ` | `âŒ` | `âœ…` |
| **é”™è¯¯å¤„ç†** | `âŒ` | `âŒ` | `âŒ` | `âœ…` | `âŒ` |
| **æ—¥å¿—è®°å½•** | `âœ…` | `âœ…` | `âœ…` | `âœ…` | `âœ…` |

### 8.2 è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºæœ€ä½³å®è·µ


**ğŸ¯ æ¨èçš„è¿‡æ»¤å™¨é¡ºåº**

```xml
<!-- 1. ç¼–ç è¿‡æ»¤å™¨ï¼ˆæœ€å…ˆæ‰§è¡Œï¼‰ -->
<filter-mapping>
    <filter-name>CharacterEncodingFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>

<!-- 2. æ—¥å¿—è¿‡æ»¤å™¨ -->
<filter-mapping>
    <filter-name>LoggingFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>

<!-- 3. è·¨åŸŸè¿‡æ»¤å™¨ -->
<filter-mapping>
    <filter-name>CorsFilter</filter-name>
    <url-pattern>/api/*</url-pattern>
</filter-mapping>

<!-- 4. è®¤è¯è¿‡æ»¤å™¨ -->
<filter-mapping>
    <filter-name>AuthenticationFilter</filter-name>
    <url-pattern>/admin/*</url-pattern>
</filter-mapping>

<!-- 5. æƒé™è¿‡æ»¤å™¨ï¼ˆæœ€åæ‰§è¡Œä¸šåŠ¡æ£€æŸ¥ï¼‰ -->
<filter-mapping>
    <filter-name>AuthorizationFilter</filter-name>
    <url-pattern>/admin/*</url-pattern>
</filter-mapping>
```

> ğŸ’¡ **é¡ºåºåŸåˆ™**
> 
> - **åŸºç¡€è®¾æ–½ç±»**ï¼ˆç¼–ç ã€æ—¥å¿—ï¼‰æ”¾åœ¨æœ€å‰é¢
> - **å®‰å…¨ç±»**ï¼ˆè®¤è¯ã€æƒé™ï¼‰æ”¾åœ¨ä¸­é—´
> - **ä¸šåŠ¡ç±»**æ”¾åœ¨æœ€å

### 8.3 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**ğŸ”¸ é¿å…ä¸å¿…è¦çš„è¿‡æ»¤å™¨æ‰§è¡Œ**

```java
public class SmartFilter implements Filter {
    
    // ğŸ¯ åªå¤„ç†ç‰¹å®šç±»å‹çš„è¯·æ±‚
    private static final Set<String> HANDLED_EXTENSIONS = 
        Set.of(".jsp", ".html", ".do");
    
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        HttpServletRequest req = (HttpServletRequest) request;
        String uri = req.getRequestURI();
        
        // ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼šè·³è¿‡é™æ€èµ„æº
        if (isStaticResource(uri)) {
            chain.doFilter(request, response);
            return;
        }
        
        // å®é™…è¿‡æ»¤é€»è¾‘
        performFiltering(request, response, chain);
    }
    
    private boolean isStaticResource(String uri) {
        return uri.contains("/static/") || 
               uri.endsWith(".css") || 
               uri.endsWith(".js") || 
               uri.endsWith(".png") || 
               uri.endsWith(".jpg");
    }
}
```

### 8.4 è°ƒè¯•ä¸æ•…éšœæ’é™¤


**ğŸ”¸ è°ƒè¯•æŠ€å·§**

```java
@WebFilter("/*")
public class DebugFilter implements Filter {
    
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
        HttpServletRequest req = (HttpServletRequest) request;
        
        // ğŸ” è°ƒè¯•ä¿¡æ¯è¾“å‡º
        System.out.println("=== è¿‡æ»¤å™¨è°ƒè¯•ä¿¡æ¯ ===");
        System.out.println("ğŸŒ è¯·æ±‚URL: " + req.getRequestURL());
        System.out.println("ğŸ“‹ è°ƒåº¦ç±»å‹: " + req.getDispatcherType());
        System.out.println("ğŸ”§ è¯·æ±‚æ–¹æ³•: " + req.getMethod());
        System.out.println("â° æ—¶é—´æˆ³: " + new Date());
        
        long startTime = System.currentTimeMillis();
        
        chain.doFilter(request, response);
        
        long endTime = System.currentTimeMillis();
        System.out.println("â±ï¸ å¤„ç†è€—æ—¶: " + (endTime - startTime) + "ms");
        System.out.println("======================");
    }
}
```

**ğŸ”¸ å¸¸è§é—®é¢˜æ’æŸ¥æ¸…å•**

```
âœ… æ£€æŸ¥æ¸…å•ï¼š
â–¡ è¿‡æ»¤å™¨æ˜¯å¦æ­£ç¡®é…ç½®åœ¨web.xmlä¸­ï¼Ÿ
â–¡ URLæ¨¡å¼åŒ¹é…æ˜¯å¦æ­£ç¡®ï¼Ÿ
â–¡ è°ƒåº¦ç±»å‹é…ç½®æ˜¯å¦å®Œæ•´ï¼Ÿ
â–¡ è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºæ˜¯å¦åˆç†ï¼Ÿ
â–¡ æ˜¯å¦æ­£ç¡®è°ƒç”¨äº†chain.doFilter()ï¼Ÿ
â–¡ å¼‚æ­¥è¿‡æ»¤å™¨æ˜¯å¦è®¾ç½®äº†asyncSupported=trueï¼Ÿ
â–¡ é”™è¯¯é¡µé¢é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ‰§è¡Œé¡ºåºï¼šåŸºäºweb.xmlé…ç½®é¡ºåºï¼Œå½¢æˆè°ƒç”¨æ ˆç»“æ„
ğŸ”¸ FilterChainï¼šè¿‡æ»¤å™¨é“¾æ¡ï¼Œchain.doFilter()æ˜¯å…³é”®è°ƒç”¨
ğŸ”¸ äº”ç§è°ƒåº¦ï¼šREQUESTï¼ˆç›´æ¥ï¼‰ã€FORWARDï¼ˆè½¬å‘ï¼‰ã€INCLUDEï¼ˆåŒ…å«ï¼‰ã€ERRORï¼ˆé”™è¯¯ï¼‰ã€ASYNCï¼ˆå¼‚æ­¥ï¼‰
ğŸ”¸ é…ç½®åŸåˆ™ï¼šåˆç†æ’åºï¼Œæ˜ç¡®è°ƒåº¦ç±»å‹ï¼Œé€‚åº¦ä½¿ç”¨
ğŸ”¸ æœ€ä½³å®è·µï¼šåŸºç¡€è®¾æ–½â†’å®‰å…¨æ£€æŸ¥â†’ä¸šåŠ¡é€»è¾‘çš„é¡ºåºåŸåˆ™
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¿‡æ»¤å™¨æ‰§è¡Œçš„"æ ˆ"ç‰¹æ€§**
```
ç†è§£è¦ç‚¹ï¼š
- è¯·æ±‚æ—¶ï¼šæŒ‰é…ç½®é¡ºåºæ‰§è¡Œï¼ˆå…ˆè¿›ï¼‰
- å“åº”æ—¶ï¼šæŒ‰ç›¸åé¡ºåºæ‰§è¡Œï¼ˆåå‡ºï¼‰
- å½¢æˆ"ä¿„ç½—æ–¯å¥—å¨ƒ"ç»“æ„
```

**ğŸ”¹ è°ƒåº¦ç±»å‹çš„å®é™…æ„ä¹‰**
```
å®ç”¨ä»·å€¼ï¼š
- REQUESTï¼šå¤„ç†ç”¨æˆ·ç›´æ¥è®¿é—®
- FORWARDï¼šå¤„ç†å†…éƒ¨é¡µé¢è·³è½¬  
- INCLUDEï¼šå¤„ç†é¡µé¢æ¨¡å—ç»„è£…
- ERRORï¼šå¤„ç†å‹å¥½é”™è¯¯å±•ç¤º
- ASYNCï¼šå¤„ç†é•¿æ—¶é—´ä»»åŠ¡
```

**ğŸ”¹ FilterChainçš„è°ƒç”¨æ—¶æœº**
```
å…³é”®ç†è§£ï¼š
- è°ƒç”¨å‰ï¼šå‰ç½®å¤„ç†é€»è¾‘
- è°ƒç”¨æ—¶ï¼šä¼ é€’æ§åˆ¶æƒ
- è°ƒç”¨åï¼šåç½®å¤„ç†é€»è¾‘
- ä¸è°ƒç”¨ï¼šä¸­æ–­è¯·æ±‚å¤„ç†
```

### 9.3 å®é™…å¼€å‘å»ºè®®


**ğŸ¯ é…ç½®å»ºè®®**
```
æ¨èåšæ³•ï¼š
âœ… ä½¿ç”¨web.xmlé…ç½®å¤æ‚çš„è¿‡æ»¤å™¨é¡ºåº
âœ… æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„è°ƒåº¦ç±»å‹
âœ… ä¸ºå¼‚æ­¥å¤„ç†è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
âœ… å®ç°å‹å¥½çš„é”™è¯¯å¤„ç†é¡µé¢

é¿å…é™·é˜±ï¼š
âŒ ä¸è¦è¿‡åº¦ä¾èµ–æ³¨è§£é…ç½®é¡ºåº
âŒ ä¸è¦å¿˜è®°è°ƒç”¨chain.doFilter()
âŒ ä¸è¦åœ¨æ‰€æœ‰è°ƒåº¦ç±»å‹ä¸Šéƒ½é…ç½®åŒä¸€ä¸ªè¿‡æ»¤å™¨
âŒ ä¸è¦å¿˜è®°ä¸ºå¼‚æ­¥æ“ä½œè®¾ç½®asyncSupported=true
```

**ğŸ”§ è°ƒè¯•æŠ€å·§**
```
æœ‰æ•ˆæ–¹æ³•ï¼š
- ä½¿ç”¨System.out.println()è·Ÿè¸ªæ‰§è¡Œæµç¨‹
- è®°å½•è¯·æ±‚çš„è°ƒåº¦ç±»å‹å’ŒURL
- ç›‘æ§è¿‡æ»¤å™¨æ‰§è¡Œæ—¶é—´
- æ£€æŸ¥è¿‡æ»¤å™¨é…ç½®çš„åŒ¹é…è§„åˆ™
```

**ğŸš€ æ€§èƒ½ä¼˜åŒ–**
```
ä¼˜åŒ–ç­–ç•¥ï¼š
- é™æ€èµ„æºè·³è¿‡è¿‡æ»¤å™¨å¤„ç†
- åˆç†è®¾ç½®è¿‡æ»¤å™¨çš„URLæ¨¡å¼
- é¿å…åœ¨è¿‡æ»¤å™¨ä¸­æ‰§è¡Œé‡é‡çº§æ“ä½œ
- ä½¿ç”¨å¼‚æ­¥å¤„ç†é•¿æ—¶é—´ä»»åŠ¡
```

### 9.4 å­¦ä¹ æ£€æŸ¥æ¸…å•


```
ğŸ¯ è‡ªæˆ‘æ£€æµ‹ï¼š
â–¡ èƒ½å¦è§£é‡Šè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºåŸç†ï¼Ÿ
â–¡ èƒ½å¦åŒºåˆ†äº”ç§è°ƒåº¦ç±»å‹çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ
â–¡ èƒ½å¦æ­£ç¡®é…ç½®å¤šä¸ªè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼Ÿ
â–¡ èƒ½å¦å®ç°å¼‚æ­¥è¯·æ±‚çš„å¤„ç†ï¼Ÿ
â–¡ èƒ½å¦é…ç½®å‹å¥½çš„é”™è¯¯å¤„ç†é¡µé¢ï¼Ÿ
â–¡ èƒ½å¦è°ƒè¯•è¿‡æ»¤å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é—®é¢˜ï¼Ÿ
â–¡ èƒ½å¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„è°ƒåº¦ç±»å‹ï¼Ÿ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
*"é…ç½®é¡ºåºå®šæ‰§è¡Œï¼Œäº”ç§è°ƒåº¦å„ä¸åŒï¼›REQUESTç›´æ¥è®¿é—®ç”¨ï¼ŒFORWARDå†…éƒ¨æ¥è½¬é€ï¼›INCLUDEç»„è£…é¡µé¢å—ï¼ŒERRORå‹å¥½æ˜¾æç¤ºï¼›ASYNCå¼‚æ­¥é•¿ä»»åŠ¡ï¼ŒFilterChainæ˜¯å…³é”®"*

---

> ğŸ’¡ **å­¦ä¹ æç¤º**
> 
> è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºå’Œè°ƒåº¦æœºåˆ¶æ˜¯JavaWebä¸­çš„é«˜çº§æ¦‚å¿µï¼Œéœ€è¦åœ¨å®é™…é¡¹ç›®ä¸­å¤šåŠ ç»ƒä¹ ã€‚å»ºè®®ä»ç®€å•çš„ç¼–ç è¿‡æ»¤å™¨å¼€å§‹ï¼Œé€æ­¥å°è¯•æ›´å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œè¿™æ ·æ‰èƒ½çœŸæ­£æŒæ¡è¿™äº›æ¦‚å¿µçš„ç²¾é«“ã€‚è®°ä½ï¼Œç†è®ºè”ç³»å®é™…æ˜¯å­¦ä¹ æŠ€æœ¯çš„æœ€ä½³æ–¹å¼ï¼