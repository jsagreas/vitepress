---
title: 1ã€ä¸šåŠ¡å±‚èŒè´£ä¸ä½œç”¨
---
## ğŸ“š ç›®å½•

1. [Serviceå±‚çš„åŸºæœ¬æ¦‚å¿µ](#1-Serviceå±‚çš„åŸºæœ¬æ¦‚å¿µ)
2. [Serviceå±‚çš„æ ¸å¿ƒèŒè´£](#2-Serviceå±‚çš„æ ¸å¿ƒèŒè´£)
3. [ä¸šåŠ¡é€»è¾‘å°è£…åŸç†](#3-ä¸šåŠ¡é€»è¾‘å°è£…åŸç†)
4. [äº‹åŠ¡ç®¡ç†è¯¦è§£](#4-äº‹åŠ¡ç®¡ç†è¯¦è§£)
5. [Serviceå±‚è®¾è®¡æ¨¡å¼](#5-Serviceå±‚è®¾è®¡æ¨¡å¼)
6. [å®æˆ˜æ¡ˆä¾‹åˆ†æ](#6-å®æˆ˜æ¡ˆä¾‹åˆ†æ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Serviceå±‚çš„åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Serviceå±‚


> ğŸ’¡ **é€šä¿—ç†è§£**: Serviceå±‚å°±åƒæ˜¯ä¸€å®¶é¤å…çš„å¨å¸ˆé•¿ï¼ŒControlleræ˜¯æœåŠ¡å‘˜ï¼ŒDAOæ˜¯é£Ÿæä»“åº“ã€‚æœåŠ¡å‘˜æ¥åˆ°å®¢äººç‚¹é¤åï¼Œä¸æ˜¯ç›´æ¥å»ä»“åº“æ‹¿é£Ÿæï¼Œè€Œæ˜¯æŠŠè®¢å•äº¤ç»™å¨å¸ˆé•¿ï¼Œç”±å¨å¸ˆé•¿æ¥å†³å®šç”¨ä»€ä¹ˆé£Ÿæã€æ€ä¹ˆæ­é…ã€æŒ‰ä»€ä¹ˆæ­¥éª¤åˆ¶ä½œã€‚

**Serviceå±‚çš„æœ¬è´¨**ï¼š
```
å®¢æˆ·è¯·æ±‚ â†’ Controller(æœåŠ¡å‘˜) â†’ Service(å¨å¸ˆé•¿) â†’ DAO(é£Ÿæä»“åº“)
         â†‘                    â†‘                  â†‘
    æ¥æ”¶è¯·æ±‚               å¤„ç†ä¸šåŠ¡é€»è¾‘          æ•°æ®æ“ä½œ
```

### 1.2 Serviceå±‚åœ¨ä¸‰å±‚æ¶æ„ä¸­çš„ä½ç½®


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¨ç°å±‚(Webå±‚)   â”‚ â† Controlleræ§åˆ¶å™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸šåŠ¡å±‚(Service) â”‚ â† ä¸šåŠ¡é€»è¾‘å¤„ç† â˜…æ ¸å¿ƒå±‚â˜…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æŒä¹…å±‚(DAOå±‚)   â”‚ â† æ•°æ®åº“æ“ä½œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆéœ€è¦Serviceå±‚ï¼Ÿ**
- ğŸ”¸ **ä¸šåŠ¡é€»è¾‘é›†ä¸­**ï¼šæŠŠå¤æ‚çš„ä¸šåŠ¡è§„åˆ™ç»Ÿä¸€ç®¡ç†
- ğŸ”¸ **ä»£ç å¤ç”¨**ï¼šå¤šä¸ªControllerå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªService
- ğŸ”¸ **è§£è€¦åˆ**ï¼šControllerä¸ç›´æ¥æ“ä½œæ•°æ®åº“
- ğŸ”¸ **äº‹åŠ¡ç®¡ç†**ï¼šç»Ÿä¸€å¤„ç†æ•°æ®çš„ä¸€è‡´æ€§

### 1.3 Serviceå±‚ä¸å…¶ä»–å±‚çš„å…³ç³»


| å±‚æ¬¡ | **ä½œç”¨** | **ä¸Serviceå±‚å…³ç³»** | **æ¯”å–»** |
|------|----------|-------------------|---------|
| ğŸŒ **Controllerå±‚** | `æ¥æ”¶è¯·æ±‚ï¼Œè¿”å›å“åº”` | `è°ƒç”¨Serviceå¤„ç†ä¸šåŠ¡` | `é¤å…æœåŠ¡å‘˜` |
| ğŸ§  **Serviceå±‚** | `å¤„ç†ä¸šåŠ¡é€»è¾‘` | `æ ¸å¿ƒä¸šåŠ¡å¤„ç†å±‚` | `é¤å…å¨å¸ˆé•¿` |
| ğŸ’¾ **DAOå±‚** | `æ•°æ®åº“æ“ä½œ` | `è¢«Serviceè°ƒç”¨` | `é£Ÿæä»“åº“` |

---

## 2. ğŸ› ï¸ Serviceå±‚çš„æ ¸å¿ƒèŒè´£


### 2.1 ä¸šåŠ¡é€»è¾‘å°è£…


> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**: ä¸šåŠ¡é€»è¾‘å°±æ˜¯ä½ çš„åº”ç”¨è¦åšä»€ä¹ˆäº‹æƒ…çš„è§„åˆ™ã€‚æ¯”å¦‚ç”¨æˆ·æ³¨å†Œæ—¶éœ€è¦æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦é‡å¤ï¼Œä¸‹è®¢å•æ—¶éœ€è¦æ£€æŸ¥åº“å­˜æ˜¯å¦è¶³å¤Ÿã€‚

**ä¸šåŠ¡é€»è¾‘çš„ç‰¹ç‚¹**ï¼š
- âœ… **ä¸å…·ä½“æŠ€æœ¯æ— å…³**ï¼šä¸ç®¡ç”¨MySQLè¿˜æ˜¯Oracleï¼Œä¸šåŠ¡è§„åˆ™éƒ½ä¸€æ ·
- âœ… **ä½“ç°ä¸šåŠ¡ä»·å€¼**ï¼šç›´æ¥å…³ç³»åˆ°ç³»ç»Ÿèƒ½ä¸ºç”¨æˆ·æä¾›ä»€ä¹ˆæœåŠ¡
- âœ… **ç›¸å¯¹ç¨³å®š**ï¼šæŠ€æœ¯å¯èƒ½ä¼šå˜ï¼Œä½†ä¸šåŠ¡è§„åˆ™å˜åŒ–ç›¸å¯¹è¾ƒå°‘

**ä¸¾ä¸ªä¾‹å­**ï¼šç”¨æˆ·æ³¨å†Œä¸šåŠ¡é€»è¾‘
```java
// âŒ é”™è¯¯åšæ³•ï¼šControllerç›´æ¥å¤„ç†æ‰€æœ‰é€»è¾‘
@Controller
public class UserController {
    public String register(User user) {
        // éªŒè¯ç”¨æˆ·åé•¿åº¦
        if(user.getUsername().length() < 3) {
            return "ç”¨æˆ·åå¤ªçŸ­";
        }
        // æ£€æŸ¥ç”¨æˆ·åé‡å¤
        if(userDAO.findByUsername(user.getUsername()) != null) {
            return "ç”¨æˆ·åå·²å­˜åœ¨";
        }
        // å¯†ç åŠ å¯†
        user.setPassword(encrypt(user.getPassword()));
        // ä¿å­˜ç”¨æˆ·
        userDAO.save(user);
        return "æ³¨å†ŒæˆåŠŸ";
    }
}
```

```java
// âœ… æ­£ç¡®åšæ³•ï¼šServiceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘
@Service
public class UserService {
    public boolean registerUser(User user) throws BusinessException {
        // 1. ä¸šåŠ¡è§„åˆ™éªŒè¯
        validateUserInfo(user);
        // 2. æ£€æŸ¥é‡å¤
        checkDuplicate(user.getUsername());
        // 3. æ•°æ®å¤„ç†
        user.setPassword(encryptPassword(user.getPassword()));
        user.setCreateTime(new Date());
        // 4. ä¿å­˜æ•°æ®
        return userDAO.save(user) > 0;
    }
}
```

### 2.2 äº‹åŠ¡ç®¡ç†


> ğŸ’¡ **ä»€ä¹ˆæ˜¯äº‹åŠ¡**: äº‹åŠ¡å°±åƒé“¶è¡Œè½¬è´¦ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚æ¯”å¦‚Aç»™Bè½¬100å…ƒï¼Œå¿…é¡»Aè´¦æˆ·å‡100ä¸”Bè´¦æˆ·åŠ 100åŒæ—¶æˆåŠŸï¼Œä¸èƒ½åªæˆåŠŸä¸€åŠã€‚

**äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰**ï¼š
- ğŸ”¸ **åŸå­æ€§(Atomicity)**ï¼šè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš
- ğŸ”¸ **ä¸€è‡´æ€§(Consistency)**ï¼šæ•°æ®ä¿æŒåˆç†çŠ¶æ€
- ğŸ”¸ **éš”ç¦»æ€§(Isolation)**ï¼šå¤šä¸ªäº‹åŠ¡äº’ä¸å¹²æ‰°
- ğŸ”¸ **æŒä¹…æ€§(Durability)**ï¼šæäº¤åæ•°æ®æ°¸ä¹…ä¿å­˜

**Serviceå±‚äº‹åŠ¡ç®¡ç†ç¤ºä¾‹**ï¼š
```java
@Service
public class OrderService {
    
    @Transactional  // è¿™ä¸ªæ³¨è§£è®©æ•´ä¸ªæ–¹æ³•åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­
    public void createOrder(Order order, List<OrderItem> items) {
        // æ­¥éª¤1ï¼šä¿å­˜è®¢å•
        orderDAO.save(order);
        
        // æ­¥éª¤2ï¼šä¿å­˜è®¢å•æ˜ç»†
        for(OrderItem item : items) {
            orderItemDAO.save(item);
            // æ­¥éª¤3ï¼šå‡åº“å­˜
            productDAO.updateStock(item.getProductId(), -item.getQuantity());
        }
        
        // å¦‚æœä»»ä½•ä¸€æ­¥å‡ºé”™ï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šå›æ»š
    }
}
```

### 2.3 ä¸šåŠ¡è§„åˆ™å®ç°


**å¸¸è§ä¸šåŠ¡è§„åˆ™ç±»å‹**ï¼š

| è§„åˆ™ç±»å‹ | **è¯´æ˜** | **ç¤ºä¾‹** |
|---------|---------|---------|
| ğŸ“‹ **éªŒè¯è§„åˆ™** | `æ£€æŸ¥æ•°æ®åˆæ³•æ€§` | `æ‰‹æœºå·æ ¼å¼ã€å¯†ç å¼ºåº¦` |
| ğŸ”’ **æƒé™è§„åˆ™** | `æ§åˆ¶æ“ä½œæƒé™` | `åªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ç« ` |
| ğŸ’° **è®¡ç®—è§„åˆ™** | `ä¸šåŠ¡æ•°å€¼è®¡ç®—` | `è®¢å•æ€»ä»·ã€ä¼šå‘˜æŠ˜æ‰£` |
| ğŸ”„ **æµç¨‹è§„åˆ™** | `ä¸šåŠ¡æµç¨‹æ§åˆ¶` | `è®¢å•çŠ¶æ€æµè½¬` |

### 2.4 é€»è¾‘å¤ç”¨


> ğŸ” **ä¸ºä»€ä¹ˆè¦å¤ç”¨**: æƒ³è±¡ä¸€ä¸‹ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Œå¯èƒ½åœ¨ç½‘ç«™ã€æ‰‹æœºAPPã€å°ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°ï¼Œå¦‚æœæ¯ä¸ªåœ°æ–¹éƒ½å†™ä¸€éç™»å½•é€»è¾‘ï¼Œç»´æŠ¤èµ·æ¥å°±å¾ˆéº»çƒ¦ã€‚

**å¤ç”¨çš„å¥½å¤„**ï¼š
```
å¤šä¸ªControllerä½¿ç”¨åŒä¸€ä¸ªService:

WebController â”€â”€â”
                â”œâ”€â”€ UserService â”€â”€ UserDAO
AppController â”€â”€â”˜

å¥½å¤„ï¼š
âœ… ä»£ç åªå†™ä¸€é
âœ… ä¸šåŠ¡é€»è¾‘ç»Ÿä¸€
âœ… ç»´æŠ¤æˆæœ¬ä½
âœ… æµ‹è¯•æ›´ç®€å•
```

---

## 3. ğŸ§© ä¸šåŠ¡é€»è¾‘å°è£…åŸç†


### 3.1 å°è£…çš„æ ¸å¿ƒæ€æƒ³


> ğŸ’­ **å°è£…å°±åƒæ‰‹æœº**: ä½ ç”¨æ‰‹æœºæ‰“ç”µè¯æ—¶ï¼Œä¸éœ€è¦çŸ¥é“ç”µè·¯æ¿æ€ä¹ˆå·¥ä½œï¼Œåªéœ€è¦æŒ‰é”®å°±è¡Œã€‚Serviceå±‚å°è£…å°±æ˜¯æŠŠå¤æ‚çš„ä¸šåŠ¡å¤„ç†è¿‡ç¨‹åŒ…è£…èµ·æ¥ï¼Œå¯¹å¤–æä¾›ç®€å•çš„æ¥å£ã€‚

**å°è£…çš„ä¸‰ä¸ªå±‚æ¬¡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å¯¹å¤–æ¥å£ç®€å•æ˜äº†           â”‚ â† Controllerçœ‹åˆ°çš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      å†…éƒ¨ä¸šåŠ¡é€»è¾‘å¤æ‚å¤„ç†         â”‚ â† Serviceå†…éƒ¨å®ç°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    åº•å±‚æ•°æ®æ“ä½œå’ŒæŠ€æœ¯ç»†èŠ‚         â”‚ â† DAOå±‚å®ç°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä¸šåŠ¡é€»è¾‘å°è£…å®ä¾‹


**æ¡ˆä¾‹ï¼šç”¨æˆ·è´­ä¹°å•†å“çš„ä¸šåŠ¡æµç¨‹**

```java
@Service
public class PurchaseService {
    
    // å¯¹å¤–æä¾›çš„ç®€å•æ¥å£
    public PurchaseResult buyProduct(Long userId, Long productId, Integer quantity) {
        try {
            // å†…éƒ¨å°è£…äº†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
            return processPurchase(userId, productId, quantity);
        } catch (Exception e) {
            return PurchaseResult.failure("è´­ä¹°å¤±è´¥ï¼š" + e.getMessage());
        }
    }
    
    // å†…éƒ¨ä¸šåŠ¡é€»è¾‘å¤„ç†
    private PurchaseResult processPurchase(Long userId, Long productId, Integer quantity) {
        // æ­¥éª¤1ï¼šéªŒè¯ç”¨æˆ·çŠ¶æ€
        User user = validateUser(userId);
        
        // æ­¥éª¤2ï¼šæ£€æŸ¥å•†å“ä¿¡æ¯
        Product product = validateProduct(productId, quantity);
        
        // æ­¥éª¤3ï¼šè®¡ç®—ä»·æ ¼
        BigDecimal totalPrice = calculatePrice(product, quantity, user);
        
        // æ­¥éª¤4ï¼šæ£€æŸ¥ç”¨æˆ·ä½™é¢
        validateUserBalance(user, totalPrice);
        
        // æ­¥éª¤5ï¼šåˆ›å»ºè®¢å•
        Order order = createOrder(user, product, quantity, totalPrice);
        
        // æ­¥éª¤6ï¼šå‡åº“å­˜
        updateStock(productId, quantity);
        
        // æ­¥éª¤7ï¼šæ‰£è´¹
        deductBalance(userId, totalPrice);
        
        return PurchaseResult.success(order);
    }
}
```

### 3.3 å°è£…çš„è®¾è®¡åŸåˆ™


**ğŸ¯ å•ä¸€èŒè´£åŸåˆ™**ï¼š
```java
// âŒ é”™è¯¯ï¼šä¸€ä¸ªæ–¹æ³•åšå¤ªå¤šäº‹æƒ…
public void manageUser(User user, String action) {
    if("create".equals(action)) {
        // åˆ›å»ºç”¨æˆ·é€»è¾‘
    } else if("update".equals(action)) {
        // æ›´æ–°ç”¨æˆ·é€»è¾‘
    } else if("delete".equals(action)) {
        // åˆ é™¤ç”¨æˆ·é€»è¾‘
    }
}

// âœ… æ­£ç¡®ï¼šæ¯ä¸ªæ–¹æ³•åªåšä¸€ä»¶äº‹
public void createUser(User user) { /* åˆ›å»ºç”¨æˆ· */ }
public void updateUser(User user) { /* æ›´æ–°ç”¨æˆ· */ }
public void deleteUser(Long userId) { /* åˆ é™¤ç”¨æˆ· */ }
```

---

## 4. ğŸ”„ äº‹åŠ¡ç®¡ç†è¯¦è§£


### 4.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ç®¡ç†


> ğŸ¦ **é“¶è¡Œè½¬è´¦ä¾‹å­**: å¼ ä¸‰ç»™æå››è½¬è´¦1000å…ƒï¼Œè¿™ä¸ªæ“ä½œåŒ…å«ä¸¤æ­¥ï¼š
> 1. å¼ ä¸‰è´¦æˆ·å‡å°‘1000å…ƒ
> 2. æå››è´¦æˆ·å¢åŠ 1000å…ƒ
> 
> è¿™ä¸¤æ­¥å¿…é¡»åŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥ï¼Œä¸èƒ½åªå®Œæˆä¸€æ­¥ï¼Œè¿™å°±æ˜¯äº‹åŠ¡çš„ä½œç”¨ã€‚

### 4.2 Serviceå±‚äº‹åŠ¡ç®¡ç†çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆåœ¨Serviceå±‚ç®¡ç†äº‹åŠ¡ï¼Ÿ**

```
ä¸šåŠ¡æ“ä½œå±‚æ¬¡ï¼š
Controllerï¼šæ¥æ”¶è¯·æ±‚ â† ä¸éœ€è¦äº‹åŠ¡ï¼ˆåªæ˜¯è½¬å‘ï¼‰
Serviceï¼šä¸šåŠ¡é€»è¾‘   â† éœ€è¦äº‹åŠ¡ï¼ˆå¤šä¸ªæ•°æ®æ“ä½œï¼‰
DAOï¼šæ•°æ®æ“ä½œ      â† å•ä¸ªæ“ä½œï¼ˆç²’åº¦å¤ªå°ï¼‰
```

**äº‹åŠ¡ç®¡ç†çš„å…¸å‹åœºæ™¯**ï¼š

| åœºæ™¯ | **æ¶‰åŠçš„æ•°æ®æ“ä½œ** | **ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡** |
|------|------------------|-------------------|
| ğŸ›’ **ä¸‹è®¢å•** | `åˆ›å»ºè®¢å• + å‡åº“å­˜ + ç”Ÿæˆç‰©æµ` | `ä»»ä½•ä¸€æ­¥å¤±è´¥éƒ½è¦å…¨éƒ¨å›æ»š` |
| ğŸ’° **è½¬è´¦** | `Aè´¦æˆ·æ‰£æ¬¾ + Bè´¦æˆ·å…¥è´¦` | `é˜²æ­¢é’±å‡­ç©ºæ¶ˆå¤±æˆ–å¢åŠ ` |
| ğŸ‘¤ **ç”¨æˆ·æ³¨å†Œ** | `ä¿å­˜ç”¨æˆ· + åˆ›å»ºé’±åŒ… + å‘é€é‚®ä»¶` | `é¿å…æ•°æ®ä¸å®Œæ•´` |

### 4.3 äº‹åŠ¡ç®¡ç†å®ç°æ–¹å¼


**å£°æ˜å¼äº‹åŠ¡ç®¡ç†**ï¼ˆæ¨èä½¿ç”¨ï¼‰ï¼š
```java
@Service
public class AccountService {
    
    @Transactional(rollbackFor = Exception.class)
    public void transfer(Long fromUserId, Long toUserId, BigDecimal amount) {
        // æ£€æŸ¥ä½™é¢
        Account fromAccount = accountDAO.findByUserId(fromUserId);
        if (fromAccount.getBalance().compareTo(amount) < 0) {
            throw new BusinessException("ä½™é¢ä¸è¶³");
        }
        
        // æ‰£æ¬¾
        accountDAO.updateBalance(fromUserId, amount.negate());
        
        // å…¥è´¦
        accountDAO.updateBalance(toUserId, amount);
        
        // è®°å½•æµæ°´
        transactionDAO.save(new TransactionRecord(fromUserId, toUserId, amount));
    }
}
```

**äº‹åŠ¡ä¼ æ’­è¡Œä¸º**ï¼š
- ğŸ”¸ **REQUIRED**ï¼šå¦‚æœæœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±åˆ›å»ºæ–°çš„ï¼ˆé»˜è®¤ï¼‰
- ğŸ”¸ **REQUIRES_NEW**ï¼šæ€»æ˜¯åˆ›å»ºæ–°äº‹åŠ¡
- ğŸ”¸ **SUPPORTS**ï¼šæœ‰äº‹åŠ¡å°±ç”¨ï¼Œæ²¡æœ‰å°±ç®—äº†

---

## 5. ğŸ—ï¸ Serviceå±‚è®¾è®¡æ¨¡å¼


### 5.1 æ¥å£ä¸å®ç°åˆ†ç¦»


> ğŸ“± **å……ç”µå™¨ä¾‹å­**: USBæ¥å£æ˜¯æ ‡å‡†ï¼Œä¸ç®¡æ˜¯è‹¹æœè¿˜æ˜¯å®‰å“å……ç”µå™¨ï¼Œéƒ½éµå¾ªUSBæ ‡å‡†ã€‚Serviceæ¥å£å°±åƒUSBæ ‡å‡†ï¼Œå…·ä½“å®ç°å¯ä»¥ä¸åŒã€‚

```java
// å®šä¹‰Serviceæ¥å£
public interface UserService {
    boolean register(User user);
    User login(String username, String password);
    void updateProfile(User user);
}

// å…·ä½“å®ç°
@Service
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserDAO userDAO;
    
    @Override
    public boolean register(User user) {
        // å…·ä½“çš„æ³¨å†Œä¸šåŠ¡é€»è¾‘
        return true;
    }
}
```

**è¿™æ ·åšçš„å¥½å¤„**ï¼š
- âœ… **æ˜“äºæµ‹è¯•**ï¼šå¯ä»¥åˆ›å»ºæµ‹è¯•ç”¨çš„å‡å®ç°
- âœ… **æ˜“äºæ›¿æ¢**ï¼šå¯ä»¥åˆ‡æ¢ä¸åŒçš„å®ç°æ–¹å¼
- âœ… **ä»£ç æ¸…æ™°**ï¼šæ¥å£è¯´æ˜èƒ½åšä»€ä¹ˆï¼Œå®ç°è¯´æ˜æ€ä¹ˆåš

### 5.2 æœåŠ¡ç»„åˆæ¨¡å¼


**ä»€ä¹ˆæ˜¯æœåŠ¡ç»„åˆï¼Ÿ**
> ğŸ± **ä¾¿å½“ä¾‹å­**: ä¸€ä¸ªä¾¿å½“åŒ…å«ç±³é¥­ã€èœå“ã€æ±¤ï¼Œæ¯æ ·éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä½†ç»„åˆèµ·æ¥å°±æ˜¯å®Œæ•´çš„ä¸€é¤ã€‚Serviceç»„åˆå°±æ˜¯æŠŠå¤šä¸ªå°æœåŠ¡ç»„åˆæˆå¤§æœåŠ¡ã€‚

```java
@Service
public class OrderService {
    
    @Autowired
    private UserService userService;      // ç”¨æˆ·æœåŠ¡
    
    @Autowired
    private ProductService productService;  // å•†å“æœåŠ¡
    
    @Autowired
    private PaymentService paymentService;  // æ”¯ä»˜æœåŠ¡
    
    @Transactional
    public OrderResult createOrder(OrderRequest request) {
        // 1. éªŒè¯ç”¨æˆ·
        User user = userService.validateUser(request.getUserId());
        
        // 2. æ£€æŸ¥å•†å“
        Product product = productService.checkStock(request.getProductId(), request.getQuantity());
        
        // 3. è®¡ç®—é‡‘é¢
        BigDecimal amount = productService.calculatePrice(product, request.getQuantity());
        
        // 4. å¤„ç†æ”¯ä»˜
        PaymentResult payment = paymentService.processPayment(user.getId(), amount);
        
        // 5. åˆ›å»ºè®¢å•
        Order order = new Order(user, product, request.getQuantity(), amount);
        orderDAO.save(order);
        
        return OrderResult.success(order);
    }
}
```

---

## 6. ğŸ’¼ å®æˆ˜æ¡ˆä¾‹åˆ†æ


### 6.1 ç”µå•†ç³»ç»Ÿç”¨æˆ·æœåŠ¡è®¾è®¡


**ä¸šåŠ¡éœ€æ±‚åˆ†æ**ï¼š
- ğŸ‘¤ ç”¨æˆ·æ³¨å†Œï¼ˆéªŒè¯ä¿¡æ¯ã€æ£€æŸ¥é‡å¤ã€å¯†ç åŠ å¯†ï¼‰
- ğŸ” ç”¨æˆ·ç™»å½•ï¼ˆéªŒè¯è´¦å¯†ã€æ›´æ–°ç™»å½•æ—¶é—´ï¼‰
- âœï¸ ä¿®æ”¹èµ„æ–™ï¼ˆæƒé™æ£€æŸ¥ã€æ•°æ®éªŒè¯ï¼‰
- ğŸ”’ ä¿®æ”¹å¯†ç ï¼ˆæ—§å¯†ç éªŒè¯ã€æ–°å¯†ç åŠ å¯†ï¼‰

```java
@Service
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserDAO userDAO;
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    /**
     * ç”¨æˆ·æ³¨å†Œä¸šåŠ¡
     */
    @Transactional
    public RegisterResult register(RegisterRequest request) {
        // 1. æ•°æ®éªŒè¯
        validateRegisterData(request);
        
        // 2. æ£€æŸ¥ç”¨æˆ·åé‡å¤
        if (userDAO.existsByUsername(request.getUsername())) {
            return RegisterResult.failure("ç”¨æˆ·åå·²å­˜åœ¨");
        }
        
        // 3. æ£€æŸ¥é‚®ç®±é‡å¤  
        if (userDAO.existsByEmail(request.getEmail())) {
            return RegisterResult.failure("é‚®ç®±å·²è¢«ä½¿ç”¨");
        }
        
        // 4. åˆ›å»ºç”¨æˆ·å¯¹è±¡
        User user = new User();
        user.setUsername(request.getUsername());
        user.setEmail(request.getEmail());
        user.setPassword(passwordEncoder.encode(request.getPassword()));
        user.setCreateTime(new Date());
        user.setStatus(UserStatus.ACTIVE);
        
        // 5. ä¿å­˜ç”¨æˆ·
        userDAO.save(user);
        
        // 6. åˆ›å»ºç”¨æˆ·é’±åŒ…ï¼ˆå‡è®¾éœ€è¦ï¼‰
        createUserWallet(user.getId());
        
        return RegisterResult.success("æ³¨å†ŒæˆåŠŸ");
    }
    
    /**
     * ç”¨æˆ·ç™»å½•ä¸šåŠ¡
     */
    public LoginResult login(String username, String password) {
        // 1. æŸ¥æ‰¾ç”¨æˆ·
        User user = userDAO.findByUsername(username);
        if (user == null) {
            return LoginResult.failure("ç”¨æˆ·åä¸å­˜åœ¨");
        }
        
        // 2. éªŒè¯å¯†ç 
        if (!passwordEncoder.matches(password, user.getPassword())) {
            return LoginResult.failure("å¯†ç é”™è¯¯");
        }
        
        // 3. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
        if (user.getStatus() != UserStatus.ACTIVE) {
            return LoginResult.failure("è´¦æˆ·å·²è¢«ç¦ç”¨");
        }
        
        // 4. æ›´æ–°ç™»å½•ä¿¡æ¯
        updateLoginInfo(user.getId());
        
        return LoginResult.success(user, "ç™»å½•æˆåŠŸ");
    }
}
```

### 6.2 å¤æ‚ä¸šåŠ¡åœºæ™¯ï¼šè®¢å•å¤„ç†


**è®¢å•ä¸šåŠ¡åˆ†æ**ï¼š
```
è®¢å•å¤„ç†æµç¨‹ï¼š
ç”¨æˆ·ä¸‹å• â†’ éªŒè¯å•†å“ â†’ è®¡ç®—ä»·æ ¼ â†’ æ£€æŸ¥åº“å­˜ â†’ é”å®šåº“å­˜ â†’ åˆ›å»ºè®¢å• â†’ æ‰£è´¹ â†’ å‘è´§

æ¶‰åŠçš„æ•°æ®è¡¨ï¼š
- è®¢å•è¡¨(orders)
- è®¢å•æ˜ç»†è¡¨(order_items)  
- å•†å“è¡¨(products)
- åº“å­˜è¡¨(inventory)
- ç”¨æˆ·ä½™é¢è¡¨(user_balance)
```

```java
@Service
public class OrderServiceImpl implements OrderService {
    
    @Transactional(rollbackFor = Exception.class)
    public CreateOrderResult createOrder(CreateOrderRequest request) {
        // 1. éªŒè¯ç”¨æˆ·
        User user = validateAndGetUser(request.getUserId());
        
        // 2. éªŒè¯å•†å“å’Œè®¡ç®—æ€»ä»·
        List<OrderItem> orderItems = new ArrayList<>();
        BigDecimal totalAmount = BigDecimal.ZERO;
        
        for (OrderItemRequest itemRequest : request.getItems()) {
            // æ£€æŸ¥å•†å“å­˜åœ¨æ€§å’Œåº“å­˜
            Product product = productService.validateProduct(
                itemRequest.getProductId(), 
                itemRequest.getQuantity()
            );
            
            // è®¡ç®—å•é¡¹é‡‘é¢
            BigDecimal itemAmount = product.getPrice()
                .multiply(BigDecimal.valueOf(itemRequest.getQuantity()));
            totalAmount = totalAmount.add(itemAmount);
            
            // åˆ›å»ºè®¢å•é¡¹
            OrderItem orderItem = new OrderItem();
            orderItem.setProductId(product.getId());
            orderItem.setProductName(product.getName());
            orderItem.setPrice(product.getPrice());
            orderItem.setQuantity(itemRequest.getQuantity());
            orderItem.setAmount(itemAmount);
            orderItems.add(orderItem);
        }
        
        // 3. åº”ç”¨ä¼˜æƒ åˆ¸ï¼ˆå¦‚æœæœ‰ï¼‰
        if (request.getCouponId() != null) {
            totalAmount = applyCoupon(request.getCouponId(), totalAmount);
        }
        
        // 4. æ£€æŸ¥ç”¨æˆ·ä½™é¢
        if (!balanceService.checkBalance(user.getId(), totalAmount)) {
            throw new BusinessException("ä½™é¢ä¸è¶³");
        }
        
        // 5. é”å®šåº“å­˜
        for (OrderItem item : orderItems) {
            inventoryService.lockStock(item.getProductId(), item.getQuantity());
        }
        
        // 6. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUserId(user.getId());
        order.setOrderNo(generateOrderNo());
        order.setTotalAmount(totalAmount);
        order.setStatus(OrderStatus.PENDING_PAYMENT);
        order.setCreateTime(new Date());
        orderDAO.save(order);
        
        // 7. ä¿å­˜è®¢å•æ˜ç»†
        for (OrderItem item : orderItems) {
            item.setOrderId(order.getId());
            orderItemDAO.save(item);
        }
        
        // 8. æ‰£è´¹
        balanceService.deduct(user.getId(), totalAmount, "è®¢å•æ”¯ä»˜");
        
        // 9. æ›´æ–°è®¢å•çŠ¶æ€
        order.setStatus(OrderStatus.PAID);
        order.setPayTime(new Date());
        orderDAO.update(order);
        
        return CreateOrderResult.success(order);
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Serviceå±‚æœ¬è´¨ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†çš„æ ¸å¿ƒå±‚ï¼Œè¿æ¥Controllerå’ŒDAO
ğŸ”¸ ä¸»è¦èŒè´£ï¼šä¸šåŠ¡é€»è¾‘å°è£…ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™å®ç°ã€é€»è¾‘å¤ç”¨
ğŸ”¸ è®¾è®¡åŸåˆ™ï¼šæ¥å£ä¸å®ç°åˆ†ç¦»ã€å•ä¸€èŒè´£ã€æœåŠ¡ç»„åˆ
ğŸ”¸ äº‹åŠ¡ç®¡ç†ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨Serviceå±‚ç»Ÿä¸€ç®¡ç†
ğŸ”¸ ä»£ç å¤ç”¨ï¼šå¤šä¸ªControllerå…±äº«åŒä¸€Serviceï¼Œå‡å°‘é‡å¤ä»£ç 
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Serviceå±‚çš„ä»·å€¼**
```
æ²¡æœ‰Serviceå±‚çš„é—®é¢˜ï¼š
- Controllerç›´æ¥è°ƒç”¨DAOï¼Œä¸šåŠ¡é€»è¾‘åˆ†æ•£
- ç›¸åŒä¸šåŠ¡é€»è¾‘é‡å¤ç¼–å†™
- äº‹åŠ¡ç®¡ç†å›°éš¾
- ä»£ç è€¦åˆåº¦é«˜ï¼Œéš¾ä»¥ç»´æŠ¤

æœ‰Serviceå±‚çš„å¥½å¤„ï¼š
- ä¸šåŠ¡é€»è¾‘é›†ä¸­ç®¡ç†
- ä»£ç å¤ç”¨æ€§å¼º
- äº‹åŠ¡ç®¡ç†ç»Ÿä¸€
- å±‚æ¬¡ç»“æ„æ¸…æ™°
```

**ğŸ”¹ ä»€ä¹ˆæ—¶å€™éœ€è¦Serviceå±‚**
```
ç®€å•CRUDæ“ä½œï¼šå¯ä»¥ä¸éœ€è¦Serviceå±‚
å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼šå¿…é¡»è¦Serviceå±‚
æ¶‰åŠäº‹åŠ¡ï¼šéœ€è¦Serviceå±‚
å¤šè¡¨æ“ä½œï¼šéœ€è¦Serviceå±‚
ä¸šåŠ¡è§„åˆ™å¤æ‚ï¼šéœ€è¦Serviceå±‚
```

**ğŸ”¹ Serviceå±‚è®¾è®¡è¦ç‚¹**
```
æ¥å£è®¾è®¡ï¼š
- æ–¹æ³•åæ¸…æ™°è¡¨è¾¾ä¸šåŠ¡å«ä¹‰
- å‚æ•°ç®€æ´ï¼Œè¿”å›å€¼æ˜ç¡®
- å¼‚å¸¸å¤„ç†æœºåˆ¶å®Œå–„

å®ç°è®¾è®¡ï¼š
- å•ä¸€èŒè´£ï¼Œä¸€ä¸ªæ–¹æ³•åšä¸€ä»¶äº‹
- åˆç†ä½¿ç”¨äº‹åŠ¡æ³¨è§£
- é€‚å½“çš„ä¸šåŠ¡éªŒè¯
- æ¸…æ™°çš„é”™è¯¯å¤„ç†
```

### 7.3 å®é™…å¼€å‘æŒ‡å¯¼


**ğŸ“ Serviceå±‚å‘½åè§„èŒƒ**
```java
æ¥å£å‘½åï¼šXxxService
å®ç°å‘½åï¼šXxxServiceImpl
æ–¹æ³•å‘½åï¼šåŠ¨è¯+åè¯ï¼ˆcreateUserã€updateProductï¼‰
```

**ğŸ”§ å¸¸ç”¨æ³¨è§£**
- `@Service`ï¼šæ ‡è¯†Serviceå±‚ç»„ä»¶
- `@Transactional`ï¼šå£°æ˜äº‹åŠ¡ç®¡ç†
- `@Autowired`ï¼šä¾èµ–æ³¨å…¥

**âš ï¸ å¸¸è§é”™è¯¯é¿å…**
- âŒ Serviceå±‚ç›´æ¥è¿”å›DAOå±‚å¯¹è±¡
- âŒ åœ¨Controllerå±‚å†™ä¸šåŠ¡é€»è¾‘
- âŒ Serviceå±‚æ–¹æ³•èŒè´£ä¸æ¸…æ™°
- âŒ å¿˜è®°äº‹åŠ¡ç®¡ç†

**ğŸ’¡ æœ€ä½³å®è·µ**
- âœ… åˆç†åˆ’åˆ†Serviceå±‚ç²’åº¦
- âœ… ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶
- âœ… é€‚å½“çš„æ—¥å¿—è®°å½•
- âœ… å……åˆ†çš„å•å…ƒæµ‹è¯•

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Serviceå±‚æ˜¯ä¸šåŠ¡æ ¸å¿ƒï¼Œå°è£…é€»è¾‘ç®¡äº‹åŠ¡
- æ¥å£å®ç°è¦åˆ†ç¦»ï¼Œå•ä¸€èŒè´£å¥½ç»´æŠ¤  
- å¤ç”¨ä»£ç å‡é‡å¤ï¼Œç»„åˆæœåŠ¡æ›´çµæ´»
- äº‹åŠ¡ç®¡ç†ä¿ä¸€è‡´ï¼Œå¼‚å¸¸å¤„ç†è¦å®Œå–„