---
title: 2ã€Servletä½œä¸ºControllerå®ç°
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Servletä½œä¸ºController](#1-ä»€ä¹ˆæ˜¯Servletä½œä¸ºController)
2. [HttpServletæ ¸å¿ƒæ¦‚å¿µ](#2-HttpServletæ ¸å¿ƒæ¦‚å¿µ)
3. [doGetä¸doPostæ–¹æ³•è¯¦è§£](#3-doGetä¸doPostæ–¹æ³•è¯¦è§£)
4. [è¯·æ±‚å¯¹è±¡HttpServletRequest](#4-è¯·æ±‚å¯¹è±¡HttpServletRequest)
5. [å“åº”å¯¹è±¡HttpServletResponse](#5-å“åº”å¯¹è±¡HttpServletResponse)
6. [å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼](#6-å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼)
7. [è¯·æ±‚åˆ†å‘æœºåˆ¶](#7-è¯·æ±‚åˆ†å‘æœºåˆ¶)
8. [å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·ç®¡ç†ç³»ç»Ÿ](#8-å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·ç®¡ç†ç³»ç»Ÿ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯Servletä½œä¸ºController


### 1.1 Controllerå±‚çš„ä½œç”¨


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šControllerå°±åƒé¤å…çš„æœåŠ¡å‘˜ï¼Œè´Ÿè´£æ¥æ”¶é¡¾å®¢ç‚¹é¤éœ€æ±‚ï¼Œç„¶åå‘Šè¯‰å¨æˆ¿åšä»€ä¹ˆèœï¼Œæœ€åæŠŠèœç«¯ç»™é¡¾å®¢

**Controllerå±‚åœ¨ä¸‰å±‚æ¶æ„ä¸­çš„ä½ç½®**ï¼š
```
æµè§ˆå™¨è¯·æ±‚ â†’ Controllerå±‚(æ¥æ”¶å¤„ç†) â†’ Serviceå±‚(ä¸šåŠ¡é€»è¾‘) â†’ DAOå±‚(æ•°æ®åº“)
              â†“
         è¿”å›å“åº”ç»™æµè§ˆå™¨
```

**Controllerå±‚çš„æ ¸å¿ƒèŒè´£**ï¼š
- â­ **æ¥æ”¶è¯·æ±‚**ï¼šè·å–ç”¨æˆ·ä»æµè§ˆå™¨å‘æ¥çš„æ•°æ®
- â­ **è°ƒç”¨ä¸šåŠ¡**ï¼šæŠŠè¯·æ±‚äº¤ç»™Serviceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘  
- â­ **è¿”å›å“åº”**ï¼šæŠŠå¤„ç†ç»“æœè¿”å›ç»™æµè§ˆå™¨
- â­ **é¡µé¢è·³è½¬**ï¼šå†³å®šç”¨æˆ·çœ‹åˆ°å“ªä¸ªé¡µé¢

### 1.2 ä¸ºä»€ä¹ˆç”¨ServletåšController


**Servletçš„å¤©ç„¶ä¼˜åŠ¿**ï¼š
- âœ… **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šTomcatè‡ªåŠ¨ç®¡ç†Servletçš„åˆ›å»ºå’Œé”€æ¯
- âœ… **è¯·æ±‚å“åº”å¤„ç†**ï¼šå†…ç½®HTTPè¯·æ±‚å’Œå“åº”å¯¹è±¡
- âœ… **çº¿ç¨‹å®‰å…¨**ï¼šæ¯ä¸ªè¯·æ±‚åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­å¤„ç†
- âœ… **é…ç½®çµæ´»**ï¼šé€šè¿‡æ³¨è§£æˆ–web.xmlé…ç½®URLæ˜ å°„

**å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| **Servlet** | `è½»é‡çº§ï¼Œæ€§èƒ½å¥½ï¼Œå­¦ä¹ æˆæœ¬ä½` | `åŠŸèƒ½ç›¸å¯¹ç®€å•` | `ä¸­å°å‹é¡¹ç›®ï¼Œå­¦ä¹ é˜¶æ®µ` |
| **Spring MVC** | `åŠŸèƒ½å¼ºå¤§ï¼Œç”Ÿæ€å®Œå–„` | `å­¦ä¹ æˆæœ¬é«˜ï¼Œé…ç½®å¤æ‚` | `ä¼ä¸šçº§å¤§å‹é¡¹ç›®` |
| **Struts2** | `åŠŸèƒ½ä¸°å¯Œï¼Œæ’ä»¶å¤š` | `æ€§èƒ½ä¸€èˆ¬ï¼Œå®‰å…¨é—®é¢˜å¤š` | `ä¼ ç»Ÿä¼ä¸šé¡¹ç›®` |

---

## 2. ğŸ“‹ HttpServletæ ¸å¿ƒæ¦‚å¿µ


### 2.1 ä»€ä¹ˆæ˜¯HttpServlet


> ğŸ’¡ **ç®€å•ç†è§£**ï¼šHttpServletæ˜¯Javaæä¾›çš„ä¸€ä¸ªä¸“é—¨å¤„ç†HTTPè¯·æ±‚çš„ç±»ï¼Œå°±åƒä¸€ä¸ª"ä¸‡èƒ½æ¥å¾…å‘˜"

**HttpServletçš„ç»§æ‰¿å…³ç³»**ï¼š
```
GenericServlet (é€šç”¨Servletæ¥å£)
       â†“
   HttpServlet (ä¸“é—¨å¤„ç†HTTPè¯·æ±‚)
       â†“
  ä½ çš„Servletç±» (ç»§æ‰¿HttpServlet)
```

### 2.2 HttpServletçš„ç”Ÿå‘½å‘¨æœŸ


**â­ ä¸‰ä¸ªå…³é”®é˜¶æ®µ**ï¼š

â‘  **åˆå§‹åŒ–é˜¶æ®µ** - `init()`
```
ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰§è¡Œï¼Œåªæ‰§è¡Œä¸€æ¬¡
ä½œç”¨ï¼šåˆå§‹åŒ–èµ„æºï¼Œè¿æ¥æ•°æ®åº“ç­‰
```

â‘¡ **æœåŠ¡é˜¶æ®µ** - `service()`
```
æ¯æ¬¡è¯·æ±‚éƒ½æ‰§è¡Œ
ä½œç”¨ï¼šæ ¹æ®è¯·æ±‚æ–¹æ³•è°ƒç”¨doGetæˆ–doPost
```

â‘¢ **é”€æ¯é˜¶æ®µ** - `destroy()`
```
æœåŠ¡å™¨å…³é—­æ—¶æ‰§è¡Œ
ä½œç”¨ï¼šé‡Šæ”¾èµ„æºï¼Œå…³é—­è¿æ¥ç­‰
```

**ç”Ÿå‘½å‘¨æœŸç¤ºæ„å›¾**ï¼š
```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ Tomcatæ£€æŸ¥Servletæ˜¯å¦å­˜åœ¨
                    â†“
               ç¬¬ä¸€æ¬¡è®¿é—®ï¼Ÿ
                â†“        â†“
              æ˜¯çš„      ä¸æ˜¯
                â†“        â†“
           åˆ›å»ºå¯¹è±¡â†’init()  ç›´æ¥è°ƒç”¨service()
                â†“        â†“
            service() â† â†  
                â†“
         doGet() æˆ– doPost()
```

### 2.3 åˆ›å»ºHttpServletçš„æ­¥éª¤


**Step 1ï¼šåˆ›å»ºServletç±»**
```java
@WebServlet("/user")  // æ³¨è§£é…ç½®è®¿é—®è·¯å¾„
public class UserServlet extends HttpServlet {
    // ç»§æ‰¿HttpServlet
}
```

**Step 2ï¼šé‡å†™å¯¹åº”æ–¹æ³•**
```java
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
    // å¤„ç†GETè¯·æ±‚
}

@Override  
protected void doPost(HttpServletRequest req, HttpServletResponse resp) {
    // å¤„ç†POSTè¯·æ±‚
}
```

> âš ï¸ **æ–°æ‰‹æ³¨æ„**ï¼šä¸éœ€è¦é‡å†™service()æ–¹æ³•ï¼ŒHttpServletä¼šè‡ªåŠ¨æ ¹æ®è¯·æ±‚ç±»å‹è°ƒç”¨doGetæˆ–doPost

---

## 3. ğŸ”„ doGetä¸doPostæ–¹æ³•è¯¦è§£


### 3.1 HTTPè¯·æ±‚æ–¹æ³•å›é¡¾


**GET vs POST çš„æœ¬è´¨åŒºåˆ«**ï¼š

| ç‰¹æ€§ | **GETè¯·æ±‚** | **POSTè¯·æ±‚** |
|------|------------|--------------|
| **æ•°æ®ä¼ é€’** | `URLå‚æ•°(?name=value)` | `è¯·æ±‚ä½“ä¸­` |
| **æ•°æ®å¤§å°** | `æœ‰é™åˆ¶(é€šå¸¸2KB)` | `æ— é™åˆ¶` |
| **å®‰å…¨æ€§** | `å‚æ•°å¯è§ï¼Œä¸å®‰å…¨` | `ç›¸å¯¹å®‰å…¨` |
| **ç¼“å­˜** | `ä¼šè¢«ç¼“å­˜` | `ä¸ä¼šè¢«ç¼“å­˜` |
| **ç”¨é€”** | `æŸ¥è¯¢æ•°æ®` | `æäº¤æ•°æ®` |

### 3.2 doGetæ–¹æ³•è¯¦è§£


**ä»€ä¹ˆæ—¶å€™è°ƒç”¨doGet**ï¼š
- ğŸ”¸ ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥URL
- ğŸ”¸ ç‚¹å‡»è¶…é“¾æ¥ `<a href="/user">`
- ğŸ”¸ è¡¨å•method="get" `<form method="get">`

**doGetå…¸å‹ç”¨æ³•**ï¼š
```java
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
        throws ServletException, IOException {
    
    // 1. è·å–è¯·æ±‚å‚æ•°
    String userId = req.getParameter("id");
    
    // 2. è°ƒç”¨ä¸šåŠ¡å±‚
    UserService userService = new UserService();
    User user = userService.findById(userId);
    
    // 3. è®¾ç½®å“åº”æ•°æ®
    req.setAttribute("user", user);
    
    // 4. é¡µé¢è·³è½¬
    req.getRequestDispatcher("/user-detail.jsp").forward(req, resp);
}
```

### 3.3 doPostæ–¹æ³•è¯¦è§£


**ä»€ä¹ˆæ—¶å€™è°ƒç”¨doPost**ï¼š
- ğŸ”¸ è¡¨å•method="post" `<form method="post">`
- ğŸ”¸ Ajax POSTè¯·æ±‚
- ğŸ”¸ æ–‡ä»¶ä¸Šä¼ è¡¨å•

**doPostå…¸å‹ç”¨æ³•**ï¼š
```java
@Override
protected void doPost(HttpServletRequest req, HttpServletResponse resp) 
        throws ServletException, IOException {
    
    // 1. è®¾ç½®è¯·æ±‚ç¼–ç (é˜²æ­¢ä¸­æ–‡ä¹±ç )
    req.setCharacterEncoding("UTF-8");
    
    // 2. è·å–è¡¨å•æ•°æ®
    String username = req.getParameter("username");
    String password = req.getParameter("password");
    
    // 3. ä¸šåŠ¡å¤„ç†
    UserService userService = new UserService();
    boolean success = userService.register(username, password);
    
    // 4. æ ¹æ®ç»“æœè·³è½¬
    if (success) {
        resp.sendRedirect("/success.jsp");
    } else {
        req.setAttribute("error", "æ³¨å†Œå¤±è´¥");
        req.getRequestDispatcher("/register.jsp").forward(req, resp);
    }
}
```

### 3.4 GETå’ŒPOSTçš„å®é™…åº”ç”¨åœºæ™¯


**ğŸ” GETè¯·æ±‚åœºæ™¯**ï¼š
- **æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨**ï¼š`/user?page=1&size=10`
- **å•†å“è¯¦æƒ…é¡µ**ï¼š`/product?id=123`  
- **æœç´¢åŠŸèƒ½**ï¼š`/search?keyword=æ‰‹æœº`

**ğŸ“ POSTè¯·æ±‚åœºæ™¯**ï¼š
- **ç”¨æˆ·æ³¨å†Œ**ï¼šæäº¤æ³¨å†Œè¡¨å•
- **ç”¨æˆ·ç™»å½•**ï¼šæäº¤ç™»å½•è¡¨å•
- **æ·»åŠ å•†å“**ï¼šæäº¤å•†å“ä¿¡æ¯è¡¨å•
- **æ–‡ä»¶ä¸Šä¼ **ï¼šä¸Šä¼ å›¾ç‰‡æˆ–æ–‡æ¡£

---

## 4. ğŸ“¨ è¯·æ±‚å¯¹è±¡HttpServletRequest


### 4.1 HttpServletRequestæ˜¯ä»€ä¹ˆ


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šHttpServletRequestå°±åƒä¸€ä¸ª"å¿«é€’åŒ…è£¹"ï¼Œé‡Œé¢è£…ç€ç”¨æˆ·å‘é€ç»™æœåŠ¡å™¨çš„æ‰€æœ‰ä¿¡æ¯

**è¯·æ±‚å¯¹è±¡åŒ…å«çš„ä¿¡æ¯**ï¼š
```
ğŸ“¦ HttpServletRequeståŒ…è£¹å†…å®¹ï¼š
â”œâ”€â”€ è¯·æ±‚å‚æ•° (ç”¨æˆ·å¡«å†™çš„è¡¨å•æ•°æ®)
â”œâ”€â”€ è¯·æ±‚å¤´ä¿¡æ¯ (æµè§ˆå™¨ç±»å‹ã€æ¥æºé¡µé¢ç­‰)  
â”œâ”€â”€ è¯·æ±‚æ–¹æ³• (GET/POST)
â”œâ”€â”€ è¯·æ±‚è·¯å¾„ (è®¿é—®çš„URL)
â””â”€â”€ ä¼šè¯ä¿¡æ¯ (Sessionç›¸å…³)
```

### 4.2 è·å–è¯·æ±‚å‚æ•°


**â­ æ ¸å¿ƒæ–¹æ³•**ï¼š

â‘  **getParameter()** - è·å–å•ä¸ªå‚æ•°å€¼
```java
String username = req.getParameter("username");
String age = req.getParameter("age");
```

â‘¡ **getParameterValues()** - è·å–å¤šä¸ªåŒåå‚æ•°
```java
// å¤„ç†å¤é€‰æ¡†ï¼š<input type="checkbox" name="hobby" value="è¯»ä¹¦">
String[] hobbies = req.getParameterValues("hobby");
```

â‘¢ **getParameterMap()** - è·å–æ‰€æœ‰å‚æ•°
```java
Map<String, String[]> paramMap = req.getParameterMap();
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```java
// ç”¨æˆ·æ³¨å†Œè¡¨å•å¤„ç†
String username = req.getParameter("username");
String email = req.getParameter("email");
String password = req.getParameter("password");
String[] hobbies = req.getParameterValues("hobby");

// å‚æ•°éªŒè¯
if (username == null || username.trim().isEmpty()) {
    // å¤„ç†å‚æ•°ä¸ºç©ºçš„æƒ…å†µ
}
```

> âš ï¸ **æ–°æ‰‹æ˜“é”™ç‚¹**ï¼šgetParameter()è¿”å›çš„æ˜¯Stringç±»å‹ï¼Œå¦‚æœéœ€è¦æ•°å­—è¦æ‰‹åŠ¨è½¬æ¢

### 4.3 è·å–è¯·æ±‚å¤´ä¿¡æ¯


**å¸¸ç”¨è¯·æ±‚å¤´**ï¼š
```java
// è·å–æµè§ˆå™¨ç±»å‹
String userAgent = req.getHeader("User-Agent");

// è·å–æ¥æºé¡µé¢
String referer = req.getHeader("Referer");  

// è·å–å®¢æˆ·ç«¯IP
String clientIP = req.getRemoteAddr();
```

### 4.4 è¯·æ±‚åŸŸæ•°æ®å…±äº«


**ä»€ä¹ˆæ˜¯è¯·æ±‚åŸŸ**ï¼š
> ğŸ’¡ **å½¢è±¡æ¯”å–»**ï¼šè¯·æ±‚åŸŸå°±åƒä¸€ä¸ª"ä¸´æ—¶å‚¨ç‰©ç®±"ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å­˜æ”¾æ•°æ®

**è¯·æ±‚åŸŸçš„ç”Ÿå‘½å‘¨æœŸ**ï¼š
```
è¯·æ±‚å¼€å§‹ â†’ åˆ›å»ºè¯·æ±‚åŸŸ â†’ å­˜å‚¨æ•°æ® â†’ è½¬å‘åˆ°JSP â†’ è¯·æ±‚ç»“æŸ â†’ è¯·æ±‚åŸŸé”€æ¯
```

**è¯·æ±‚åŸŸæ“ä½œæ–¹æ³•**ï¼š
```java
// å­˜å‚¨æ•°æ®åˆ°è¯·æ±‚åŸŸ
req.setAttribute("user", userObject);
req.setAttribute("message", "æ“ä½œæˆåŠŸ");

// ä»è¯·æ±‚åŸŸè·å–æ•°æ®  
User user = (User) req.getAttribute("user");
String message = (String) req.getAttribute("message");
```

---

## 5. ğŸ“¤ å“åº”å¯¹è±¡HttpServletResponse


### 5.1 HttpServletResponseæ˜¯ä»€ä¹ˆ


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šHttpServletResponseå°±åƒ"å›å¤ä¿¡å°"ï¼Œç”¨æ¥è£…è½½æœåŠ¡å™¨è¦è¿”å›ç»™ç”¨æˆ·çš„å†…å®¹

**å“åº”å¯¹è±¡çš„ä½œç”¨**ï¼š
```
ğŸ¯ HttpServletResponseçš„èŒè´£ï¼š
â”œâ”€â”€ è®¾ç½®å“åº”çŠ¶æ€ç  (200æˆåŠŸ, 404æœªæ‰¾åˆ°, 500é”™è¯¯)
â”œâ”€â”€ è®¾ç½®å“åº”å¤´ (å†…å®¹ç±»å‹ã€ç¼–ç æ ¼å¼)
â”œâ”€â”€ è¾“å‡ºå“åº”å†…å®¹ (HTMLã€JSONã€å›¾ç‰‡ç­‰)
â””â”€â”€ é¡µé¢é‡å®šå‘ (è·³è½¬åˆ°å…¶ä»–é¡µé¢)
```

### 5.2 è®¾ç½®å“åº”å†…å®¹


**â­ è¾“å‡ºHTMLå†…å®¹**ï¼š
```java
// è®¾ç½®å“åº”ç±»å‹å’Œç¼–ç 
resp.setContentType("text/html;charset=UTF-8");

// è·å–è¾“å‡ºæµ
PrintWriter out = resp.getWriter();

// è¾“å‡ºHTMLå†…å®¹
out.println("<html>");
out.println("<body>");
out.println("<h1>æ¬¢è¿è®¿é—®</h1>");
out.println("</body>");
out.println("</html>");
```

**â­ è¾“å‡ºJSONæ•°æ®**ï¼š
```java
// è®¾ç½®JSONå“åº”ç±»å‹
resp.setContentType("application/json;charset=UTF-8");

// æ„é€ JSONå­—ç¬¦ä¸²
String jsonData = "{\"status\":\"success\",\"message\":\"æ“ä½œæˆåŠŸ\"}";

// è¾“å‡ºJSON
PrintWriter out = resp.getWriter();
out.print(jsonData);
```

### 5.3 é¡µé¢è·³è½¬æ–¹å¼


**ğŸ”„ é‡å®šå‘ vs è½¬å‘çš„åŒºåˆ«**ï¼š

| ç‰¹æ€§ | **é‡å®šå‘(redirect)** | **è½¬å‘(forward)** |
|------|---------------------|------------------|
| **åœ°å€æ ** | `ä¼šæ”¹å˜` | `ä¸ä¼šæ”¹å˜` |
| **è¯·æ±‚æ¬¡æ•°** | `2æ¬¡è¯·æ±‚` | `1æ¬¡è¯·æ±‚` |
| **æ•°æ®å…±äº«** | `ä¸èƒ½å…±äº«è¯·æ±‚åŸŸæ•°æ®` | `å¯ä»¥å…±äº«è¯·æ±‚åŸŸæ•°æ®` |
| **è·³è½¬èŒƒå›´** | `å¯ä»¥è·³è½¬åˆ°ä»»æ„ç½‘ç«™` | `åªèƒ½è·³è½¬åˆ°æœ¬é¡¹ç›®` |

**é‡å®šå‘ç¤ºä¾‹**ï¼š
```java
// é€‚ç”¨åœºæ™¯ï¼šæ“ä½œæˆåŠŸåè·³è½¬ï¼Œé¿å…é‡å¤æäº¤
resp.sendRedirect("/success.jsp");
resp.sendRedirect("http://www.baidu.com");  // å¯ä»¥è·³è½¬åˆ°å¤–éƒ¨ç½‘ç«™
```

**è½¬å‘ç¤ºä¾‹**ï¼š
```java
// é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ä¼ é€’æ•°æ®ç»™JSPé¡µé¢æ˜¾ç¤º
req.setAttribute("user", user);
req.getRequestDispatcher("/user-info.jsp").forward(req, resp);
```

**è·³è½¬æ–¹å¼é€‰æ‹©æŒ‡å—**ï¼š
- ğŸ¯ **ç”¨é‡å®šå‘**ï¼šç”¨æˆ·æäº¤è¡¨å•æˆåŠŸåï¼Œé˜²æ­¢åˆ·æ–°é‡å¤æäº¤
- ğŸ¯ **ç”¨è½¬å‘**ï¼šéœ€è¦æŠŠæ•°æ®ä¼ é€’ç»™JSPé¡µé¢æ˜¾ç¤º

---

## 6. ğŸª å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼


### 6.1 ä»€ä¹ˆæ˜¯å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼


> ğŸ’¡ **ç”Ÿæ´»æ¯”å–»**ï¼šå‰ç«¯æ§åˆ¶å™¨å°±åƒå¤§å‹å•†åœºçš„"æ€»æœåŠ¡å°"ï¼Œæ‰€æœ‰é¡¾å®¢çš„éœ€æ±‚éƒ½å…ˆåˆ°æœåŠ¡å°ï¼Œç„¶åæœåŠ¡å°æ ¹æ®éœ€æ±‚æŒ‡å¼•åˆ°å…·ä½“çš„åº—é“º

**ä¼ ç»Ÿæ–¹å¼ vs å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼**ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ç›´æ¥æ‰¾å¯¹åº”Servlet â†’ å¤„ç†ä¸šåŠ¡

å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼ï¼š  
ç”¨æˆ·è¯·æ±‚ â†’ å‰ç«¯æ§åˆ¶å™¨Servlet â†’ åˆ†å‘åˆ°å…·ä½“å¤„ç†å™¨ â†’ å¤„ç†ä¸šåŠ¡
```

### 6.2 å‰ç«¯æ§åˆ¶å™¨çš„ä¼˜åŠ¿


**âœ… é›†ä¸­ç®¡ç†**ï¼š
- ç»Ÿä¸€çš„è¯·æ±‚å…¥å£
- ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†
- ç»Ÿä¸€çš„æƒé™æ§åˆ¶

**âœ… ä»£ç å¤ç”¨**ï¼š
- å…¬å…±é€»è¾‘åªå†™ä¸€æ¬¡
- å‡å°‘ä»£ç é‡å¤

**âœ… æ˜“äºç»´æŠ¤**ï¼š
- ä¿®æ”¹å…¬å…±é€»è¾‘åªæ”¹ä¸€ä¸ªåœ°æ–¹
- æ–°å¢åŠŸèƒ½åªéœ€æ·»åŠ å¤„ç†å™¨

### 6.3 å‰ç«¯æ§åˆ¶å™¨å®ç°


**åŸºç¡€æ¶æ„**ï¼š
```java
@WebServlet("/front/*")  // æ‹¦æˆªæ‰€æœ‰/front/å¼€å¤´çš„è¯·æ±‚
public class FrontControllerServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        // 1. è·å–è¯·æ±‚è·¯å¾„
        String requestURI = req.getRequestURI();  // /project/front/user/list
        String contextPath = req.getContextPath(); // /project  
        String path = requestURI.substring(contextPath.length()); // /front/user/list
        
        // 2. æ ¹æ®è·¯å¾„åˆ†å‘è¯·æ±‚
        if (path.equals("/front/user/list")) {
            listUsers(req, resp);
        } else if (path.equals("/front/user/add")) {
            addUser(req, resp);  
        } else {
            resp.sendError(404, "é¡µé¢ä¸å­˜åœ¨");
        }
    }
    
    // å…·ä½“ä¸šåŠ¡å¤„ç†æ–¹æ³•
    private void listUsers(HttpServletRequest req, HttpServletResponse resp) {
        // å¤„ç†ç”¨æˆ·åˆ—è¡¨è¯·æ±‚
    }
    
    private void addUser(HttpServletRequest req, HttpServletResponse resp) {
        // å¤„ç†æ·»åŠ ç”¨æˆ·è¯·æ±‚  
    }
}
```

---

## 7. ğŸš¦ è¯·æ±‚åˆ†å‘æœºåˆ¶


### 7.1 ä»€ä¹ˆæ˜¯è¯·æ±‚åˆ†å‘


> ğŸ’¡ **å½¢è±¡æ¯”å–»**ï¼šè¯·æ±‚åˆ†å‘å°±åƒ"äº¤é€šæŒ‡æŒ¥"ï¼Œæ ¹æ®ä¸åŒçš„è¯·æ±‚è·¯å¾„ï¼ŒæŒ‡æŒ¥åˆ°ä¸åŒçš„å¤„ç†æ–¹æ³•

**åˆ†å‘æµç¨‹**ï¼š
```
ç”¨æˆ·è¯·æ±‚URL â†’ å‰ç«¯æ§åˆ¶å™¨æ¥æ”¶ â†’ è§£æè¯·æ±‚è·¯å¾„ â†’ åŒ¹é…å¤„ç†æ–¹æ³• â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘
```

### 7.2 åŸºäºå‚æ•°çš„åˆ†å‘


**é€šè¿‡actionå‚æ•°åˆ†å‘**ï¼š
```java
@WebServlet("/user")
public class UserServlet extends HttpServlet {
    
    @Override  
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
        // è·å–actionå‚æ•°
        String action = req.getParameter("action");
        
        // æ ¹æ®actionåˆ†å‘
        switch (action) {
            case "list":
                listUsers(req, resp);
                break;
            case "detail":  
                userDetail(req, resp);
                break;
            default:
                // é»˜è®¤æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
                listUsers(req, resp);
        }
    }
    
    // ç”¨æˆ·åˆ—è¡¨
    private void listUsers(HttpServletRequest req, HttpServletResponse resp) {
        // ä¸šåŠ¡é€»è¾‘...
    }
    
    // ç”¨æˆ·è¯¦æƒ…
    private void userDetail(HttpServletRequest req, HttpServletResponse resp) {
        // ä¸šåŠ¡é€»è¾‘...
    }
}
```

**è®¿é—®æ–¹å¼**ï¼š
- ç”¨æˆ·åˆ—è¡¨ï¼š`/user?action=list`
- ç”¨æˆ·è¯¦æƒ…ï¼š`/user?action=detail&id=1`

### 7.3 åŸºäºè·¯å¾„çš„åˆ†å‘


**é€šè¿‡URLè·¯å¾„åˆ†å‘**ï¼š
```java
@WebServlet("/user/*")  // åŒ¹é…/user/å¼€å¤´çš„æ‰€æœ‰è·¯å¾„
public class UserServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
        // è§£æè·¯å¾„
        String pathInfo = req.getPathInfo();  // è·å–/user/åé¢çš„è·¯å¾„
        
        if (pathInfo == null || pathInfo.equals("/")) {
            listUsers(req, resp);
        } else if (pathInfo.equals("/add")) {
            showAddForm(req, resp);
        } else if (pathInfo.startsWith("/detail/")) {
            String userId = pathInfo.substring(8);  // è·å–ç”¨æˆ·ID
            userDetail(req, resp, userId);
        }
    }
}
```

**è®¿é—®æ–¹å¼**ï¼š
- ç”¨æˆ·åˆ—è¡¨ï¼š`/user/` æˆ– `/user`
- æ·»åŠ ç”¨æˆ·ï¼š`/user/add`  
- ç”¨æˆ·è¯¦æƒ…ï¼š`/user/detail/123`

### 7.4 åˆ†å‘æ–¹å¼å¯¹æ¯”


| åˆ†å‘æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|----------|----------|--------------|
| **å‚æ•°åˆ†å‘** | `URLç®€å•ï¼Œæ˜“ç†è§£` | `URLä¸å¤Ÿä¼˜é›…` | `åŠŸèƒ½ç®€å•çš„é¡¹ç›®` |
| **è·¯å¾„åˆ†å‘** | `URLä¼˜é›…ï¼Œç¬¦åˆRESTful` | `è·¯å¾„è§£æç¨å¤æ‚` | `ç°ä»£Webåº”ç”¨` |

---

## 8. ğŸ› ï¸ å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·ç®¡ç†ç³»ç»Ÿ


### 8.1 éœ€æ±‚åˆ†æ


**ç³»ç»ŸåŠŸèƒ½**ï¼š
- âœ… ç”¨æˆ·åˆ—è¡¨å±•ç¤º
- âœ… æ·»åŠ æ–°ç”¨æˆ·  
- âœ… æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
- âœ… ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
- âœ… åˆ é™¤ç”¨æˆ·

**æŠ€æœ¯æ¶æ„**ï¼š
```
å‰ç«¯é¡µé¢(JSP) â†” Controller(Servlet) â†” Service(ä¸šåŠ¡å±‚) â†” DAO(æ•°æ®å±‚)
```

### 8.2 ç”¨æˆ·Controllerå®ç°


```java
@WebServlet("/user")
public class UserController extends HttpServlet {
    
    private UserService userService = new UserService();
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        String action = req.getParameter("action");
        
        switch (action != null ? action : "list") {
            case "list":
                handleUserList(req, resp);
                break;
            case "detail":
                handleUserDetail(req, resp);
                break;
            case "add":
                showAddForm(req, resp);
                break;
            case "edit":
                showEditForm(req, resp);
                break;
            case "delete":
                handleUserDelete(req, resp);
                break;
        }
    }
    
    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        req.setCharacterEncoding("UTF-8");
        String action = req.getParameter("action");
        
        switch (action) {
            case "add":
                handleUserAdd(req, resp);
                break;
            case "update":
                handleUserUpdate(req, resp);
                break;
        }
    }
    
    // ç”¨æˆ·åˆ—è¡¨
    private void handleUserList(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        List<User> users = userService.findAllUsers();
        req.setAttribute("users", users);
        req.getRequestDispatcher("/WEB-INF/views/user-list.jsp").forward(req, resp);
    }
    
    // ç”¨æˆ·è¯¦æƒ…
    private void handleUserDetail(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        String userId = req.getParameter("id");
        User user = userService.findUserById(Integer.parseInt(userId));
        
        if (user != null) {
            req.setAttribute("user", user);
            req.getRequestDispatcher("/WEB-INF/views/user-detail.jsp").forward(req, resp);
        } else {
            resp.sendRedirect("/user?action=list&error=ç”¨æˆ·ä¸å­˜åœ¨");
        }
    }
    
    // æ·»åŠ ç”¨æˆ·
    private void handleUserAdd(HttpServletRequest req, HttpServletResponse resp) 
            throws IOException {
        
        String username = req.getParameter("username");
        String email = req.getParameter("email");
        String phone = req.getParameter("phone");
        
        User user = new User();
        user.setUsername(username);
        user.setEmail(email);  
        user.setPhone(phone);
        
        boolean success = userService.addUser(user);
        
        if (success) {
            resp.sendRedirect("/user?action=list&success=æ·»åŠ æˆåŠŸ");
        } else {
            resp.sendRedirect("/user?action=add&error=æ·»åŠ å¤±è´¥");
        }
    }
}
```

### 8.3 é¡µé¢è·³è½¬æµç¨‹


**ç”¨æˆ·æ“ä½œæµç¨‹å›¾**ï¼š
```
ç”¨æˆ·è®¿é—® /user
        â†“
   æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
        â†“
  ç‚¹å‡»"æ·»åŠ ç”¨æˆ·"æŒ‰é’®
        â†“
   /user?action=add (GET)
        â†“
   æ˜¾ç¤ºæ·»åŠ ç”¨æˆ·è¡¨å•
        â†“
   å¡«å†™è¡¨å•å¹¶æäº¤
        â†“
   /user?action=add (POST)
        â†“
    å¤„ç†è¡¨å•æ•°æ®
        â†“
   é‡å®šå‘åˆ°ç”¨æˆ·åˆ—è¡¨
        â†“
   æ˜¾ç¤ºæ·»åŠ æˆåŠŸä¿¡æ¯
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ Servletä½œä¸ºControllerçš„æ ¸å¿ƒä½œç”¨ï¼š
â”œâ”€â”€ æ¥æ”¶HTTPè¯·æ±‚
â”œâ”€â”€ è°ƒç”¨ä¸šåŠ¡å±‚å¤„ç†
â”œâ”€â”€ æ§åˆ¶é¡µé¢è·³è½¬  
â””â”€â”€ è¿”å›å“åº”ç»“æœ
```

### 9.2 é‡ç‚¹çŸ¥è¯†å›é¡¾


**â­ HttpServletç”Ÿå‘½å‘¨æœŸ**ï¼š
- `init()` - åˆå§‹åŒ–ï¼Œåªæ‰§è¡Œä¸€æ¬¡
- `service()` - æ¯æ¬¡è¯·æ±‚éƒ½æ‰§è¡Œï¼Œè‡ªåŠ¨è°ƒç”¨doGet/doPost
- `destroy()` - æœåŠ¡å™¨å…³é—­æ—¶æ‰§è¡Œ

**â­ doGet vs doPost**ï¼š
- **doGet**ï¼šå¤„ç†æŸ¥è¯¢è¯·æ±‚ï¼Œå‚æ•°åœ¨URLä¸­
- **doPost**ï¼šå¤„ç†æäº¤è¯·æ±‚ï¼Œå‚æ•°åœ¨è¯·æ±‚ä½“ä¸­

**â­ è¯·æ±‚å¯¹è±¡HttpServletRequest**ï¼š
- `getParameter()` - è·å–è¯·æ±‚å‚æ•°  
- `setAttribute()` - å­˜å‚¨æ•°æ®åˆ°è¯·æ±‚åŸŸ
- `getRequestDispatcher()` - è¯·æ±‚è½¬å‘

**â­ å“åº”å¯¹è±¡HttpServletResponse**ï¼š
- `setContentType()` - è®¾ç½®å“åº”ç±»å‹
- `getWriter()` - è·å–è¾“å‡ºæµ
- `sendRedirect()` - é¡µé¢é‡å®šå‘

### 9.3 å®é™…åº”ç”¨è¦ç‚¹


**ğŸ”§ å¼€å‘å»ºè®®**ï¼š
- âœ… **å•ä¸€èŒè´£**ï¼šä¸€ä¸ªServletè´Ÿè´£ä¸€ä¸ªæ¨¡å—çš„æ‰€æœ‰æ“ä½œ
- âœ… **å‚æ•°éªŒè¯**ï¼šå§‹ç»ˆéªŒè¯ç”¨æˆ·è¾“å…¥å‚æ•°
- âœ… **å¼‚å¸¸å¤„ç†**ï¼šæ•è·å¹¶å¦¥å–„å¤„ç†å¼‚å¸¸
- âœ… **ç¼–ç è®¾ç½®**ï¼šPOSTè¯·æ±‚è¦è®¾ç½®å­—ç¬¦ç¼–ç 

**âš ï¸ å¸¸è§é™·é˜±**ï¼š
- **å¿˜è®°è®¾ç½®ç¼–ç **ï¼šå¯¼è‡´ä¸­æ–‡ä¹±ç 
- **æ··æ·†è½¬å‘å’Œé‡å®šå‘**ï¼šå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–é‡å¤æäº¤
- **å‚æ•°ä¸ºnull**ï¼šæ²¡æœ‰åˆ¤æ–­å‚æ•°æ˜¯å¦å­˜åœ¨
- **çº¿ç¨‹å®‰å…¨é—®é¢˜**ï¼šåœ¨Servletä¸­å®šä¹‰å®ä¾‹å˜é‡

**æ ¸å¿ƒè®°å¿†**ï¼š
- Servletæ˜¯Controllerå±‚çš„å®ç°æ–¹å¼
- HttpServletRequestè£…è½½è¯·æ±‚ä¿¡æ¯
- HttpServletResponseè£…è½½å“åº”ä¿¡æ¯  
- å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼ç»Ÿä¸€ç®¡ç†è¯·æ±‚åˆ†å‘