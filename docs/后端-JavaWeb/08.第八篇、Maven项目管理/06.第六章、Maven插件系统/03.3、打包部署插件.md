---
title: 3、打包部署插件
---
## 📚 目录

1. [Maven插件基础概念](#1-Maven插件基础概念)
2. [JAR打包插件详解](#2-JAR打包插件详解)
3. [WAR打包插件配置](#3-WAR打包插件配置)
4. [Assembly插件使用](#4-Assembly插件使用)
5. [Shade插件实战](#5-Shade插件实战)
6. [Web服务器插件](#6-Web服务器插件)
7. [热部署配置实践](#7-热部署配置实践)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔌 Maven插件基础概念


### 1.1 什么是Maven插件


**🔸 通俗理解**
想象你有一个万能工具箱，里面有各种专门的工具：
- 螺丝刀 → **打包插件**（把代码打包成jar/war）
- 电钻 → **编译插件**（把Java代码编译成class文件）
- 测量尺 → **测试插件**（运行单元测试）

Maven插件就是这样的**专用工具**，每个插件负责完成特定的任务。

**💡 插件的本质**
```
Maven = 项目管理框架
插件 = 具体功能的实现者

Maven本身只是一个"指挥官"
真正干活的是各种插件
```

### 1.2 插件的工作机制


**🔄 插件执行流程**
```
用户执行命令 → Maven调用对应插件 → 插件完成具体工作

例如：
mvn package → 调用打包插件 → 生成jar/war文件
mvn test → 调用测试插件 → 运行单元测试
mvn tomcat7:run → 调用tomcat插件 → 启动web服务器
```

**📋 插件配置位置**
Maven插件配置写在`pom.xml`文件的`<build>`标签里：

```xml
<build>
    <plugins>
        <plugin>
            <!-- 这里配置具体的插件 -->
        </plugin>
    </plugins>
</build>
```

---

## 2. 📦 JAR打包插件详解


### 2.1 什么是JAR包


**🔸 JAR包通俗理解**
JAR包就像一个**压缩文件**，把你的Java程序和相关文件都打包在一起：
- 你写的`.class`文件（编译后的Java代码）
- 配置文件（如`application.properties`）
- 资源文件（图片、文本等）

**💡 为什么需要JAR包？**
- **方便分发**：一个文件包含整个程序
- **方便运行**：直接`java -jar xxx.jar`就能运行
- **方便部署**：上传一个文件就行

### 2.2 默认JAR插件配置


Maven默认会使用`maven-jar-plugin`来打包，通常不需要特别配置：

```xml
<!-- 最简单的JAR打包，Maven自动处理 -->
<packaging>jar</packaging>
```

**🎯 执行打包命令**
```bash
mvn package
# 结果：在target/目录下生成 项目名-版本号.jar
```

### 2.3 可执行JAR配置


**❓ 什么是可执行JAR？**
普通JAR包需要指定主类才能运行，可执行JAR包可以直接双击或用`java -jar`运行。

**⚙️ 配置可执行JAR**
```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-jar-plugin</artifactId>
    <version>3.2.0</version>
    <configuration>
        <archive>
            <manifest>
                <!-- 指定程序入口，就是包含main方法的类 -->
                <mainClass>com.example.MyApplication</mainClass>
                <!-- 把依赖库路径加到MANIFEST.MF里 -->
                <addClasspath>true</addClasspath>
                <!-- 依赖库的前缀路径 -->
                <classpathPrefix>lib/</classpathPrefix>
            </manifest>
        </archive>
    </configuration>
</plugin>
```

**✅ 使用效果**
```bash
# 打包后可以直接运行
java -jar target/my-app-1.0.jar
```

### 2.4 JAR插件高级配置


**📁 排除特定文件**
```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-jar-plugin</artifactId>
    <configuration>
        <excludes>
            <!-- 排除测试配置文件 -->
            <exclude>**/test.properties</exclude>
            <!-- 排除临时文件 -->
            <exclude>**/*.tmp</exclude>
        </excludes>
    </configuration>
</plugin>
```

---

## 3. 🌐 WAR打包插件配置


### 3.1 什么是WAR包


**🔸 WAR包通俗理解**
WAR包是**Web应用程序包**，专门用于打包web项目：
- 包含所有的网页文件（HTML、CSS、JavaScript）
- Java的web组件（Servlet、JSP）
- 配置文件（web.xml等）
- 第三方库（jar文件）

**💡 WAR vs JAR的区别**

| 类型 | **用途** | **部署方式** | **内容结构** |
|------|---------|-------------|-------------|
| **JAR** | `桌面应用、工具程序` | `java -jar 运行` | `简单的文件打包` |
| **WAR** | `Web应用` | `部署到Tomcat等服务器` | `符合Web标准的目录结构` |

### 3.2 基础WAR打包配置


```xml
<!-- 第一步：声明项目类型为war -->
<packaging>war</packaging>

<!-- 第二步：配置war插件 -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-war-plugin</artifactId>
    <version>3.2.3</version>
    <configuration>
        <!-- war文件名，默认是 项目名-版本号.war -->
        <warName>my-web-app</warName>
        
        <!-- web.xml文件位置 -->
        <webXml>src\main\webapp\WEB-INF\web.xml</webXml>
        
        <!-- 网页文件根目录 -->
        <warSourceDirectory>src/main/webapp</warSourceDirectory>
    </configuration>
</plugin>
```

### 3.3 WAR包目录结构


**📂 标准WAR包内部结构**
```
my-app.war
├── index.html              ← 网页文件
├── css/
│   └── style.css          ← 样式文件
├── js/
│   └── app.js             ← JavaScript文件
└── WEB-INF/               ← 重要配置目录
    ├── web.xml            ← Web配置文件
    ├── classes/           ← 你编译的Java类
    │   └── com/example/
    └── lib/               ← 第三方jar包
        ├── spring.jar
        └── mysql.jar
```

### 3.4 WAR插件高级配置


**🔧 资源文件处理**
```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-war-plugin</artifactId>
    <configuration>
        <!-- 排除某些文件不打包 -->
        <packagingExcludes>
            WEB-INF/classes/test/**,
            **/*.backup
        </packagingExcludes>
        
        <!-- 添加额外的资源文件 -->
        <webResources>
            <resource>
                <directory>src/main/config</directory>
                <targetPath>WEB-INF/classes</targetPath>
                <includes>
                    <include>**/*.properties</include>
                </includes>
            </resource>
        </webResources>
    </configuration>
</plugin>
```

---

## 4. 🎯 Assembly插件使用


### 4.1 什么是Assembly插件


**🔸 Assembly插件的作用**
Assembly插件就像一个**超级打包工**，可以把项目打包成各种格式：
- **ZIP压缩包**：包含程序+文档+脚本
- **TAR.GZ包**：Linux环境常用
- **自定义包**：按你的要求组织文件

**💡 使用场景**
- 制作软件发布包（包含程序、文档、启动脚本）
- 打包项目源码给别人
- 制作部署包（包含配置文件、数据库脚本等）

### 4.2 Assembly插件基础配置


```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-assembly-plugin</artifactId>
    <version>3.3.0</version>
    <configuration>
        <!-- 指定打包规则文件 -->
        <descriptors>
            <descriptor>src/main/assembly/package.xml</descriptor>
        </descriptors>
        
        <!-- 生成的文件名不包含assembly id -->
        <appendAssemblyId>false</appendAssemblyId>
    </configuration>
    
    <executions>
        <execution>
            <phase>package</phase>
            <goals>
                <goal>single</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

### 4.3 Assembly描述文件详解


**📄 创建打包规则文件**
在`src/main/assembly/package.xml`中定义打包规则：

```xml
<assembly>
    <id>release</id>
    <!-- 输出格式：zip, tar.gz, dir等 -->
    <formats>
        <format>zip</format>
    </formats>
    
    <!-- 包含项目jar文件 -->
    <files>
        <file>
            <source>target/${project.artifactId}-${project.version}.jar</source>
            <destName>app.jar</destName>
            <outputDirectory>.</outputDirectory>
        </file>
    </files>
    
    <!-- 包含依赖库 -->
    <dependencySets>
        <dependencySet>
            <outputDirectory>lib</outputDirectory>
            <useProjectArtifact>false</useProjectArtifact>
        </dependencySet>
    </dependencySets>
    
    <!-- 包含配置文件 -->
    <fileSets>
        <fileSet>
            <directory>src/main/resources</directory>
            <outputDirectory>config</outputDirectory>
            <includes>
                <include>*.properties</include>
                <include>*.yml</include>
            </includes>
        </fileSet>
    </fileSets>
</assembly>
```

### 4.4 预定义的Assembly描述符


Maven提供了一些**现成的打包模板**：

```xml
<configuration>
    <!-- 使用预定义模板 -->
    <descriptorRefs>
        <!-- jar-with-dependencies: 把所有依赖打包到一个jar里 -->
        <descriptorRef>jar-with-dependencies</descriptorRef>
        <!-- src: 打包源代码 -->
        <descriptorRef>src</descriptorRef>
        <!-- bin: 打包可执行文件 -->
        <descriptorRef>bin</descriptorRef>
    </descriptorRefs>
</configuration>
```

---

## 5. 🔗 Shade插件实战


### 5.1 什么是Shade插件


**🔸 Shade插件解决的问题**
想象你做了一个小程序，但是它需要100个第三方库才能运行。用户要运行你的程序就得：
1. 下载你的jar包
2. 下载100个依赖库
3. 设置复杂的classpath

**Shade插件的作用**：把你的程序和所有依赖库**合并成一个大jar包**，用户只需要一个文件就能运行。

**💡 Fat JAR vs Uber JAR**
这种包含所有依赖的jar包有很多名字：
- **Fat JAR**（胖jar包）
- **Uber JAR**（超级jar包）
- **All-in-one JAR**（一体化jar包）

### 5.2 Shade插件基础配置


```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-shade-plugin</artifactId>
    <version>3.2.4</version>
    
    <executions>
        <execution>
            <phase>package</phase>
            <goals>
                <goal>shade</goal>
            </goals>
            
            <configuration>
                <!-- 指定程序入口点 -->
                <transformers>
                    <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                        <mainClass>com.example.MyApp</mainClass>
                    </transformer>
                </transformers>
            </configuration>
        </execution>
    </executions>
</plugin>
```

**✅ 使用效果**
```bash
mvn package
# 生成两个jar文件：
# target/my-app-1.0.jar          ← 普通jar包
# target/my-app-1.0-shaded.jar   ← 包含所有依赖的大jar包

# 直接运行大jar包
java -jar target/my-app-1.0-shaded.jar
```

### 5.3 Shade插件高级功能


**🚫 排除不需要的依赖**
```xml
<configuration>
    <artifactSet>
        <excludes>
            <!-- 排除测试相关的库 -->
            <exclude>junit:junit</exclude>
            <!-- 排除某个不需要的库 -->
            <exclude>org.apache.commons:commons-lang3</exclude>
        </excludes>
    </artifactSet>
</configuration>
```

**🔄 重命名包名（防止冲突）**
```xml
<configuration>
    <relocations>
        <relocation>
            <!-- 把第三方库的包名改掉，避免冲突 -->
            <pattern>com.google.common</pattern>
            <shadedPattern>my.shaded.google.common</shadedPattern>
        </relocation>
    </relocations>
</configuration>
```

---

## 6. 🖥️ Web服务器插件


### 6.1 为什么需要服务器插件


**🤔 开发Web应用的痛点**
传统开发web应用的流程：
1. 写代码
2. 打包成war文件
3. 启动Tomcat服务器
4. 把war文件拷贝到Tomcat
5. 重启Tomcat
6. 测试功能

每次修改代码都要重复这些步骤，非常麻烦！

**💡 服务器插件的好处**
使用Maven的服务器插件，只需要一个命令：
```bash
mvn tomcat7:run
# 自动启动内置服务器，直接测试
```

### 6.2 Tomcat7插件配置


```xml
<plugin>
    <groupId>org.apache.tomcat.maven</groupId>
    <artifactId>tomcat7-maven-plugin</artifactId>
    <version>2.2</version>
    
    <configuration>
        <!-- 服务器端口，默认8080 -->
        <port>8080</port>
        
        <!-- 项目访问路径 -->
        <path>/myapp</path>
        
        <!-- 字符编码 -->
        <uriEncoding>UTF-8</uriEncoding>
        
        <!-- 服务器配置文件 -->
        <server>tomcat7</server>
    </configuration>
</plugin>
```

**🚀 常用命令**

| 命令 | **作用** | **使用场景** |
|------|---------|-------------|
| `mvn tomcat7:run` | `启动服务器` | `开发调试` |
| `mvn tomcat7:run-war` | `以war包方式运行` | `模拟生产环境` |
| `mvn tomcat7:stop` | `停止服务器` | `结束调试` |

### 6.3 Jetty插件配置


**🔸 Jetty vs Tomcat**
- **Tomcat**：重量级，功能全面，生产环境常用
- **Jetty**：轻量级，启动快速，开发环境首选

```xml
<plugin>
    <groupId>org.eclipse.jetty</groupId>
    <artifactId>jetty-maven-plugin</artifactId>
    <version>9.4.43.v20210629</version>
    
    <configuration>
        <!-- HTTP端口 -->
        <httpConnector>
            <port>8080</port>
        </httpConnector>
        
        <!-- 项目根路径 -->
        <webApp>
            <contextPath>/</contextPath>
        </webApp>
        
        <!-- 自动重新加载 -->
        <reload>automatic</reload>
        <scanIntervalSeconds>3</scanIntervalSeconds>
    </configuration>
</plugin>
```

**🚀 Jetty常用命令**
```bash
mvn jetty:run          # 启动Jetty服务器
mvn jetty:run-war      # 以war包方式运行
mvn jetty:stop         # 停止服务器
```

---

## 7. 🔄 热部署配置实践


### 7.1 什么是热部署


**🔸 热部署通俗理解**
传统开发模式：
```
修改代码 → 停止服务器 → 重新编译 → 重新部署 → 启动服务器
等待时间：30秒-2分钟
```

热部署模式：
```
修改代码 → 自动检测变化 → 自动重新加载
等待时间：3-5秒
```

**💡 热部署的好处**
- **提高开发效率**：不用手动重启服务器
- **保持开发状态**：不会丢失当前的测试数据
- **快速看到效果**：修改立即生效

### 7.2 Tomcat7热部署配置


```xml
<plugin>
    <groupId>org.apache.tomcat.maven</groupId>
    <artifactId>tomcat7-maven-plugin</artifactId>
    <version>2.2</version>
    
    <configuration>
        <!-- 启用热部署 -->
        <backgroundReload>true</backgroundReload>
        
        <!-- 检测文件变化的时间间隔（秒） -->
        <reloadDelay>3</reloadDelay>
        
        <!-- 监控的目录 -->
        <watchedResources>
            <watchedResource>src/main/webapp</watchedResource>
            <watchedResource>src/main/java</watchedResource>
            <watchedResource>src/main/resources</watchedResource>
        </watchedResources>
    </configuration>
</plugin>
```

### 7.3 Jetty热部署配置


```xml
<plugin>
    <groupId>org.eclipse.jetty</groupId>
    <artifactId>jetty-maven-plugin</artifactId>
    
    <configuration>
        <!-- 自动重新加载 -->
        <reload>automatic</reload>
        
        <!-- 扫描间隔时间（秒） -->
        <scanIntervalSeconds>2</scanIntervalSeconds>
        
        <!-- 要监控的目录 -->
        <scanTargets>
            <scanTarget>src/main/webapp</scanTarget>
            <scanTarget>src/main/java</scanTarget>
            <scanTarget>src/main/resources</scanTarget>
        </scanTargets>
        
        <!-- 排除不需要监控的文件 -->
        <scanTargetPatterns>
            <scanTargetPattern>
                <directory>src/main/webapp</directory>
                <excludes>
                    <exclude>**/*.tmp</exclude>
                    <exclude>**/*.bak</exclude>
                </excludes>
            </scanTargetPattern>
        </scanTargetPatterns>
    </configuration>
</plugin>
```

### 7.4 热部署最佳实践


**⚡ 提升热部署效率的技巧**

```xml
<!-- 1. 跳过测试，加快编译速度 -->
<properties>
    <maven.test.skip>true</maven.test.skip>
</properties>

<!-- 2. 使用增量编译 -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <configuration>
        <useIncrementalCompilation>true</useIncrementalCompilation>
    </configuration>
</plugin>
```

**📋 热部署使用流程**
```
第一步：配置好热部署插件
    ↓
第二步：启动开发服务器
mvn jetty:run 或 mvn tomcat7:run
    ↓
第三步：修改代码文件
    ↓
第四步：等待自动重新加载（2-5秒）
    ↓
第五步：刷新浏览器查看效果
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本概念


```
🔸 Maven插件：完成特定任务的工具，如打包、部署、测试
🔸 JAR插件：打包Java桌面应用，生成可执行jar包
🔸 WAR插件：打包Web应用，部署到Web服务器
🔸 Assembly插件：自定义打包格式，制作发布包
🔸 Shade插件：制作包含所有依赖的Fat JAR
🔸 服务器插件：内置Web服务器，方便开发调试
🔸 热部署：自动检测代码变化并重新加载
```

### 8.2 关键理解要点


**🔹 不同打包插件的选择**
```
JAR插件 → 普通Java程序
WAR插件 → Web应用程序  
Assembly插件 → 复杂的自定义打包需求
Shade插件 → 需要独立运行的程序（不想管理依赖）
```

**🔹 开发环境 vs 生产环境**
```
开发环境：
- 使用Tomcat7/Jetty插件
- 启用热部署
- 快速迭代开发

生产环境：
- 打包成war/jar文件
- 部署到独立服务器
- 关注性能和稳定性
```

### 8.3 实际应用建议


**📌 新手学习路线**
```
第1步：掌握基础JAR打包 → 理解Maven打包概念
第2步：学习WAR打包配置 → 开发Web应用必备
第3步：使用服务器插件 → 提升开发效率
第4步：配置热部署 → 进一步优化开发体验
第5步：学习高级插件 → 应对复杂项目需求
```

**⚠️ 常见问题避坑指南**
- **打包失败**：检查`pom.xml`配置和插件版本
- **热部署不生效**：确认监控目录配置正确
- **依赖冲突**：使用Shade插件的重命名功能
- **服务器启动失败**：检查端口是否被占用

**🎯 最佳实践建议**
- **开发阶段**：使用Jetty插件+热部署，快速迭代
- **测试阶段**：使用WAR插件，模拟生产环境
- **发布阶段**：使用Assembly插件，制作完整发布包
- **工具程序**：使用Shade插件，制作独立可执行程序

**核心记忆**：
- Maven插件是完成具体任务的工具
- 不同类型的项目选择不同的打包插件
- 开发环境重点关注效率，生产环境重点关注稳定性
- 热部署是提升开发效率的重要工具