---
title: 3、EL函数库使用
---
## 📚 目录

1. [EL函数库概述](#1-EL函数库概述)
2. [JSTL Functions标签库](#2-JSTL-Functions标签库)
3. [字符串处理函数详解](#3-字符串处理函数详解)
4. [集合处理函数](#4-集合处理函数)
5. [自定义EL函数](#5-自定义EL函数)
6. [TLD文件配置详解](#6-TLD文件配置详解)
7. [实际应用场景](#7-实际应用场景)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 EL函数库概述


### 1.1 什么是EL函数库

**简单理解**：EL函数库就像是专门为JSP页面设计的"工具箱"，里面装着各种实用的小工具函数。

```
想象一下：
你在写JSP页面时，经常需要：
- 判断字符串是否为空
- 获取字符串长度
- 转换大小写
- 截取字符串等操作

EL函数库 = 现成的工具函数 + 简单的使用方式
```

### 1.2 EL函数库的作用

**核心价值**：让JSP页面中的数据处理更简单、更优雅

```
传统方式 vs EL函数库：

❌ 传统方式（复杂）：
<% 
String name = (String)request.getAttribute("name");
if(name != null && name.length() > 0) {
    out.println(name.toUpperCase());
}
%>

✅ EL函数库方式（简洁）：
${fn:toUpperCase(name)}
```

### 1.3 EL函数库的分类

```
┌─ EL函数库
│
├─ 🔧 JSTL内置函数库
│  │  ├─ fn:length（长度函数）
│  │  ├─ fn:contains（包含判断）
│  │  ├─ fn:startsWith（开头判断）
│  │  └─ 更多内置函数...
│
└─ 🛠️ 自定义函数库
   │  ├─ 业务相关函数
   │  ├─ 格式化函数
   │  └─ 工具类函数
```

---

## 2. 📦 JSTL Functions标签库


### 2.1 引入Functions标签库

**第一步**：在JSP页面顶部添加taglib指令

```jsp
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
```

> 💡 **新手提示**：这行代码的意思是告诉JSP："我要使用JSTL的函数库，给它起个别名叫'fn'"

### 2.2 Functions标签库常用函数一览表


| 函数名 | **作用说明** | **返回值** | **使用场景** |
|--------|-------------|-----------|-------------|
| `fn:length()` | `获取字符串或集合的长度` | `数字` | `验证输入长度、显示数量` |
| `fn:contains()` | `判断字符串是否包含子串` | `true/false` | `搜索功能、条件判断` |
| `fn:startsWith()` | `判断字符串是否以某个前缀开始` | `true/false` | `URL判断、分类筛选` |
| `fn:endsWith()` | `判断字符串是否以某个后缀结束` | `true/false` | `文件类型判断` |
| `fn:substring()` | `截取字符串的一部分` | `字符串` | `文本预览、摘要显示` |
| `fn:toUpperCase()` | `转换为大写` | `字符串` | `用户名显示、标题格式化` |
| `fn:toLowerCase()` | `转换为小写` | `字符串` | `邮箱格式化、搜索` |

### 2.3 基础使用语法

**语法格式**：`${fn:函数名(参数1, 参数2, ...)}`

```jsp
<!-- 基础语法示例 -->
字符串长度：${fn:length(username)}
是否包含：${fn:contains(email, '@')}
转大写：${fn:toUpperCase(title)}
```

---

## 3. 🔤 字符串处理函数详解


### 3.1 fn:length - 长度函数

**功能**：获取字符串或集合的长度

```jsp
<!-- 字符串长度 -->
用户名长度：${fn:length(username)}

<!-- 集合长度 -->
商品数量：${fn:length(productList)}

<!-- 实际应用场景 -->
<c:if test="${fn:length(username) > 6}">
    <span style="color: green;">用户名长度合适</span>
</c:if>
```

> 📝 **使用技巧**：常用于表单验证、数据统计显示

### 3.2 fn:contains - 包含判断

**功能**：判断字符串是否包含指定的子字符串

```jsp
<!-- 基础用法 -->
是否包含@符号：${fn:contains(email, '@')}

<!-- 实际应用：邮箱格式简单验证 -->
<c:choose>
    <c:when test="${fn:contains(email, '@') && fn:contains(email, '.')}">
        <span class="valid">邮箱格式正确</span>
    </c:when>
    <c:otherwise>
        <span class="invalid">邮箱格式错误</span>
    </c:otherwise>
</c:choose>
```

**常见使用场景**：
- ✅ 邮箱格式验证
- ✅ 关键词搜索高亮
- ✅ 用户权限判断

### 3.3 fn:startsWith/fn:endsWith - 前缀后缀判断

**功能**：判断字符串的开头或结尾

```jsp
<!-- 判断文件类型 -->
<c:if test="${fn:endsWith(fileName, '.jpg') || fn:endsWith(fileName, '.png')}">
    <img src="${fileName}" alt="图片">
</c:if>

<!-- 判断URL类型 -->
<c:if test="${fn:startsWith(url, 'https://')}">
    <span class="secure">安全链接</span>
</c:if>
```

### 3.4 fn:substring - 字符串截取

**功能**：截取字符串的一部分

**语法格式**：
```jsp
${fn:substring(原字符串, 开始位置, 结束位置)}
```

```jsp
<!-- 文章摘要显示 -->
<div class="article-summary">
    ${fn:substring(articleContent, 0, 100)}...
    <a href="detail.jsp?id=${article.id}">查看更多</a>
</div>

<!-- 用户名脱敏显示 -->
用户：${fn:substring(username, 0, 3)}***
```

### 3.5 大小写转换函数

```jsp
<!-- 用户名统一大写显示 -->
欢迎：${fn:toUpperCase(username)}

<!-- 邮箱统一小写存储 -->
<input type="hidden" value="${fn:toLowerCase(email)}">

<!-- 标题首字母大写效果 -->
<h2>${fn:toUpperCase(fn:substring(title, 0, 1))}${fn:toLowerCase(fn:substring(title, 1, -1))}</h2>
```

---

## 4. 📊 集合处理函数


### 4.1 集合长度获取

```jsp
<!-- 购物车商品数量 -->
购物车(${fn:length(cartItems)})

<!-- 用户列表数量显示 -->
<div class="user-count">
    共找到 ${fn:length(userList)} 位用户
</div>
```

### 4.2 集合元素包含判断

```jsp
<!-- 判断用户是否有特定角色 -->
<c:if test="${fn:contains(user.roles, 'admin')}">
    <a href="admin.jsp">管理后台</a>
</c:if>
```

---

## 5. 🛠️ 自定义EL函数


### 5.1 为什么需要自定义EL函数

**实际需求**：JSTL提供的函数虽然实用，但有时不能满足特定的业务需求

```
常见自定义函数需求：
- 日期格式化（2024-01-15 → 2024年1月15日）
- 数字格式化（1234567 → 123.45万）
- 业务数据转换（状态码 → 中文描述）
- 敏感信息脱敏（手机号 → 138****1234）
```

### 5.2 创建自定义EL函数的步骤


**步骤流程图**：
```
1. 编写Java静态方法
        ↓
2. 创建TLD文件描述函数
        ↓
3. 在JSP中引入并使用
        ↓
4. 测试函数功能
```

### 5.3 编写Java静态方法


```java
// MyFunctions.java
public class MyFunctions {
    
    /**
     * 手机号脱敏处理
     * @param phone 原手机号
     * @return 脱敏后的手机号
     */
    public static String maskPhone(String phone) {
        if (phone == null || phone.length() != 11) {
            return phone;
        }
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }
    
    /**
     * 数字格式化为中文
     * @param num 数字
     * @return 格式化后的字符串
     */
    public static String formatNumber(long num) {
        if (num < 10000) {
            return String.valueOf(num);
        } else if (num < 100000000) {
            return String.format("%.1f万", num / 10000.0);
        } else {
            return String.format("%.1f亿", num / 100000000.0);
        }
    }
}
```

> 💡 **重要提醒**：自定义EL函数的方法必须是`public static`的

---

## 6. 📋 TLD文件配置详解


### 6.1 什么是TLD文件

**TLD文件**：Tag Library Descriptor（标签库描述文件）
- **作用**：告诉Web容器你的自定义函数在哪里，怎么使用
- **位置**：放在`WEB-INF`目录下
- **格式**：XML格式文件

### 6.2 TLD文件结构详解


```xml
<?xml version="1.0" encoding="UTF-8"?>
<taglib xmlns="http://java.sun.com/xml/ns/j2ee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee 
        http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd"
        version="2.0">
    
    <!-- 标签库基本信息 -->
    <tlib-version>1.0</tlib-version>
    <short-name>my</short-name>
    <uri>http://mycompany.com/functions</uri>
    
    <!-- 函数定义 -->
    <function>
        <name>maskPhone</name>                    <!-- 函数名称 -->
        <function-class>com.example.MyFunctions</function-class>  <!-- Java类 -->
        <function-signature>java.lang.String maskPhone(java.lang.String)</function-signature>  <!-- 方法签名 -->
    </function>
    
    <function>
        <name>formatNumber</name>
        <function-class>com.example.MyFunctions</function-class>
        <function-signature>java.lang.String formatNumber(long)</function-signature>
    </function>
    
</taglib>
```

### 6.3 TLD文件配置说明

```
┌─ TLD文件配置要点
│
├─ 📝 基本信息配置
│  │  ├─ tlib-version: 标签库版本
│  │  ├─ short-name: 简短名称（建议用作前缀）
│  │  └─ uri: 唯一标识符
│
├─ 🔧 函数配置
│  │  ├─ name: 在JSP中使用的函数名
│  │  ├─ function-class: Java类的完整路径
│  │  └─ function-signature: 方法的完整签名
│
└─ ⚠️ 常见错误
   │  ├─ 方法签名写错（最常见）
   │  ├─ 类路径不正确
   │  └─ 方法不是static
```

### 6.4 在JSP中使用自定义函数


```jsp
<%@ taglib prefix="my" uri="http://mycompany.com/functions" %>

<!-- 使用自定义函数 -->
<div class="user-info">
    <p>手机号：${my:maskPhone(user.phone)}</p>
    <p>点赞数：${my:formatNumber(article.likes)}</p>
</div>
```

---

## 7. 🎯 实际应用场景


### 7.1 用户信息显示场景


```jsp
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<div class="user-profile">
    <!-- 用户名长度验证显示 -->
    <h3>${fn:toUpperCase(user.username)}
        <c:if test="${fn:length(user.username) < 3}">
            <span class="warning">(用户名过短)</span>
        </c:if>
    </h3>
    
    <!-- 邮箱验证显示 -->
    <p>邮箱：${user.email}
        <c:choose>
            <c:when test="${fn:contains(user.email, '@') && fn:contains(user.email, '.')}">
                ✅
            </c:when>
            <c:otherwise>
                ❌ 格式错误
            </c:otherwise>
        </c:choose>
    </p>
    
    <!-- 个人简介预览 -->
    <div class="bio-preview">
        ${fn:substring(user.bio, 0, 50)}
        <c:if test="${fn:length(user.bio) > 50}">
            ... <a href="javascript:showFullBio()">展开</a>
        </c:if>
    </div>
</div>
```

### 7.2 文件上传类型验证


```jsp
<c:forEach var="file" items="${uploadedFiles}">
    <div class="file-item">
        <c:choose>
            <!-- 图片文件 -->
            <c:when test="${fn:endsWith(fn:toLowerCase(file.name), '.jpg') || 
                           fn:endsWith(fn:toLowerCase(file.name), '.png') || 
                           fn:endsWith(fn:toLowerCase(file.name), '.gif')}">
                <span class="file-type">📷 图片</span>
            </c:when>
            <!-- 文档文件 -->
            <c:when test="${fn:endsWith(fn:toLowerCase(file.name), '.pdf') || 
                           fn:endsWith(fn:toLowerCase(file.name), '.doc')}">
                <span class="file-type">📄 文档</span>
            </c:when>
            <!-- 其他文件 -->
            <c:otherwise>
                <span class="file-type">📎 其他</span>
            </c:otherwise>
        </c:choose>
        
        <span class="file-name">${file.name}</span>
        <span class="file-size">(${file.size} bytes)</span>
    </div>
</c:forEach>
```

### 7.3 搜索结果高亮显示


```jsp
<c:if test="${not empty searchKeyword}">
    <div class="search-results">
        <c:forEach var="article" items="${searchResults}">
            <div class="article-item">
                <h3>
                    <c:choose>
                        <c:when test="${fn:contains(fn:toLowerCase(article.title), fn:toLowerCase(searchKeyword))}">
                            <!-- 这里可以结合JavaScript实现关键词高亮 -->
                            ${article.title} <span class="highlight">✨</span>
                        </c:when>
                        <c:otherwise>
                            ${article.title}
                        </c:otherwise>
                    </c:choose>
                </h3>
            </div>
        </c:forEach>
    </div>
</c:if>
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 EL函数库本质：为JSP页面提供的数据处理工具集合
🔸 JSTL Functions：最常用的内置函数库，处理字符串和集合
🔸 函数语法：${fn:函数名(参数1, 参数2, ...)}
🔸 自定义函数：通过Java静态方法 + TLD配置实现
🔸 TLD文件：标签库描述文件，连接Java代码和JSP页面的桥梁
```

### 8.2 常用函数速记表


| 需求场景 | **选用函数** | **使用示例** |
|---------|-------------|-------------|
| `获取长度` | `fn:length()` | `${fn:length(username)}` |
| `包含判断` | `fn:contains()` | `${fn:contains(email, '@')}` |
| `前缀判断` | `fn:startsWith()` | `${fn:startsWith(url, 'https')}` |
| `后缀判断` | `fn:endsWith()` | `${fn:endsWith(file, '.jpg')}` |
| `字符串截取` | `fn:substring()` | `${fn:substring(text, 0, 10)}` |
| `大写转换` | `fn:toUpperCase()` | `${fn:toUpperCase(name)}` |
| `小写转换` | `fn:toLowerCase()` | `${fn:toLowerCase(email)}` |

### 8.3 最佳实践建议


**✅ 推荐做法**：
- 优先使用JSTL内置函数，满足大部分需求
- 自定义函数命名要清晰易懂
- TLD文件统一放在WEB-INF目录
- 函数功能单一，便于测试和维护

**❌ 避免错误**：
- 不要在EL函数中处理复杂业务逻辑
- 避免自定义函数过度依赖外部资源
- 不要忘记在TLD文件中正确配置方法签名

### 8.4 学习进阶路径


```
入门阶段 → 掌握JSTL Functions基本用法
    ↓
进阶阶段 → 学会创建简单自定义函数
    ↓
高级阶段 → 结合业务需求开发实用函数库
    ↓
专家阶段 → 优化性能，处理特殊场景
```

### 8.5 常见问题解决


**Q: EL函数不生效怎么办？**
> 💡 检查taglib引入是否正确，TLD文件路径是否准确

**Q: 自定义函数报错？**
> 💡 确认Java方法是public static，TLD配置的方法签名正确

**Q: 函数性能问题？**
> 💡 避免在循环中使用复杂函数，考虑在Servlet中预处理数据

**核心记忆**：
- EL函数让JSP数据处理更简单
- fn:开头的是JSTL内置函数
- 自定义函数 = Java静态方法 + TLD配置
- 实际应用重在解决具体业务问题