---
title: 3ã€è·¨åŸŸä¼šè¯ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [è·¨åŸŸä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-è·¨åŸŸä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [è·¨åŸŸCookieè®¾ç½®è¯¦è§£](#2-è·¨åŸŸCookieè®¾ç½®è¯¦è§£)
3. [å•ç‚¹ç™»å½•SSOæ ¸å¿ƒåŸç†](#3-å•ç‚¹ç™»å½•SSOæ ¸å¿ƒåŸç†)
4. [OAuth2è®¤è¯æµç¨‹å®æˆ˜](#4-OAuth2è®¤è¯æµç¨‹å®æˆ˜)
5. [CASç»Ÿä¸€è®¤è¯ç³»ç»Ÿ](#5-CASç»Ÿä¸€è®¤è¯ç³»ç»Ÿ)
6. [è·¨ç³»ç»Ÿä¼šè¯å…±äº«æ–¹æ¡ˆ](#6-è·¨ç³»ç»Ÿä¼šè¯å…±äº«æ–¹æ¡ˆ)
7. [å®é™…åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ](#7-å®é™…åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ è·¨åŸŸä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è·¨åŸŸä¼šè¯ç®¡ç†


**ğŸ¤” ç”Ÿæ´»åœºæ™¯ç±»æ¯”**
> æƒ³è±¡ä½ æœ‰ä¸€å¼ é“¶è¡Œå¡ï¼Œå¯ä»¥åœ¨å…¨å›½å„åœ°çš„ATMæœºä¸Šä½¿ç”¨ã€‚ä¸ç®¡ä½ åœ¨åŒ—äº¬ã€ä¸Šæµ·è¿˜æ˜¯æ·±åœ³ï¼Œæ’å¡åé“¶è¡Œç³»ç»Ÿéƒ½èƒ½è¯†åˆ«ä½ çš„èº«ä»½ã€‚è·¨åŸŸä¼šè¯ç®¡ç†å°±æ˜¯è®©ä½ çš„"ç™»å½•èº«ä»½"åœ¨ä¸åŒçš„ç½‘ç«™ç³»ç»Ÿé—´ä¹Ÿèƒ½è¢«è¯†åˆ«ã€‚

**ğŸ“ æ ¸å¿ƒå®šä¹‰**
```
è·¨åŸŸä¼šè¯ç®¡ç†ï¼šè®©ç”¨æˆ·åœ¨ä¸€ä¸ªç³»ç»Ÿç™»å½•åï¼Œ
èƒ½å¤Ÿåœ¨ç›¸å…³çš„å…¶ä»–ç³»ç»Ÿä¸­ä¿æŒç™»å½•çŠ¶æ€ï¼Œ
æ— éœ€é‡å¤è¾“å…¥ç”¨æˆ·åå¯†ç ã€‚

ç®€å•è¯´ï¼šä¸€æ¬¡ç™»å½•ï¼Œå¤„å¤„é€šè¡Œï¼
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è·¨åŸŸä¼šè¯ç®¡ç†


**ğŸ”¥ ç°å®éœ€æ±‚åœºæ™¯**

```
å¤§å‹ä¼ä¸šçš„å›°æ‰°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äººäº‹ç®¡ç†ç³»ç»Ÿ   â”‚    â”‚   è´¢åŠ¡ç®¡ç†ç³»ç»Ÿ   â”‚    â”‚   é¡¹ç›®ç®¡ç†ç³»ç»Ÿ   â”‚
â”‚   hr.company.com â”‚    â”‚  fin.company.com â”‚    â”‚  pm.company.com â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                      â†“                      â†“
     éœ€è¦ç™»å½•                éœ€è¦ç™»å½•                éœ€è¦ç™»å½•
```

**ğŸ˜¤ æ²¡æœ‰è·¨åŸŸä¼šè¯ç®¡ç†çš„ç—›è‹¦**ï¼š
- å‘˜å·¥æ¯å¤©è¦ç™»å½•Nä¸ªç³»ç»Ÿ
- æ¯ä¸ªç³»ç»Ÿéƒ½è¦è®°ä½ä¸åŒçš„å¯†ç 
- å¯†ç å¿˜è®°äº†è¦æ‰¾Nä¸ªç®¡ç†å‘˜é‡ç½®
- ç¦»èŒå‘˜å·¥è¦åœ¨Nä¸ªç³»ç»Ÿä¸­åˆ é™¤è´¦æˆ·

**ğŸ˜Š æœ‰äº†è·¨åŸŸä¼šè¯ç®¡ç†çš„ç¾å¥½**ï¼š
- ç»Ÿä¸€ç™»å½•å…¥å£ï¼Œä¸€æ¬¡ç™»å½•å…¨éƒ¨æå®š
- ç»Ÿä¸€çš„ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- ç»Ÿä¸€çš„æƒé™æ§åˆ¶
- ä¸€é”®æ³¨é”€æ‰€æœ‰ç³»ç»Ÿ

### 1.3 è·¨åŸŸçš„æŠ€æœ¯æŒ‘æˆ˜


**ğŸš« æµè§ˆå™¨åŒæºç­–ç•¥é™åˆ¶**
```
åŒæºç­–ç•¥è¯´ï¼šåªæœ‰ç›¸åŒçš„ åè®®+åŸŸå+ç«¯å£ æ‰èƒ½å…±äº«æ•°æ®

ç¤ºä¾‹å¯¹æ¯”ï¼š
âœ… åŒæºï¼ˆå¯ä»¥å…±äº«Cookieï¼‰ï¼š
   https://www.baidu.com/search
   https://www.baidu.com/image

âŒ è·¨åŸŸï¼ˆä¸èƒ½ç›´æ¥å…±äº«Cookieï¼‰ï¼š
   https://www.baidu.com     ï¼ˆä¸»åŸŸåï¼‰
   https://tieba.baidu.com   ï¼ˆå­åŸŸåï¼‰
   https://pan.baidu.com     ï¼ˆå­åŸŸåï¼‰
```

**ğŸ’¡ æ ¸å¿ƒæŒ‘æˆ˜**ï¼š
- **Cookieæ— æ³•è·¨åŸŸå…±äº«**ï¼šAç½‘ç«™çš„Cookieï¼ŒBç½‘ç«™è¯»ä¸åˆ°
- **Sessionæ— æ³•ç›´æ¥ä¼ é€’**ï¼šæ¯ä¸ªç³»ç»Ÿçš„Sessionæ˜¯ç‹¬ç«‹çš„
- **å®‰å…¨é—®é¢˜**ï¼šå¦‚ä½•ä¿è¯è·¨åŸŸä¼ é€’èº«ä»½ä¿¡æ¯çš„å®‰å…¨æ€§

---

## 2. ğŸª è·¨åŸŸCookieè®¾ç½®è¯¦è§£


### 2.1 Cookieçš„åŸŸåé™åˆ¶


**ğŸ“– CookieåŸŸåè§„åˆ™è¯¦è§£**

```
Cookieçš„domainå±æ€§å†³å®šäº†å“ªäº›åŸŸåå¯ä»¥è®¿é—®è¿™ä¸ªCookie

è§„åˆ™è¯´æ˜ï¼š
ğŸ”¸ é»˜è®¤æƒ…å†µï¼šCookieåªèƒ½è¢«è®¾ç½®å®ƒçš„ç¡®åˆ‡åŸŸåè®¿é—®
ğŸ”¸ ä¸»åŸŸè®¾ç½®ï¼šå¯ä»¥è®¾ç½®domainä¸ºä¸»åŸŸåï¼Œè®©å­åŸŸåä¹Ÿèƒ½è®¿é—®
ğŸ”¸ å®‰å…¨é™åˆ¶ï¼šä¸èƒ½ç»™å…¶ä»–å…¬å¸çš„åŸŸåè®¾ç½®Cookie

ç¤ºä¾‹åœºæ™¯ï¼š
ç½‘ç«™ www.company.com è®¾ç½®Cookieæ—¶ï¼š
- ä¸è®¾ç½®domain â†’ åªæœ‰ www.company.com èƒ½è®¿é—®
- è®¾ç½® domain=.company.com â†’ æ‰€æœ‰ *.company.com éƒ½èƒ½è®¿é—®
```

### 2.2 è·¨å­åŸŸCookieå…±äº«å®ç°


**ğŸ› ï¸ å®é™…ä»£ç ç¤ºä¾‹**

```java
// è®¾ç½®å¯è·¨å­åŸŸçš„Cookie
@RequestMapping("/login")
public void setLoginCookie(HttpServletResponse response) {
    Cookie userCookie = new Cookie("userId", "12345");
    
    // å…³é”®è®¾ç½®ï¼šdomainè®¾ä¸ºä¸»åŸŸå
    userCookie.setDomain(".company.com");  // æ³¨æ„å‰é¢çš„ç‚¹å·
    userCookie.setPath("/");               // è®¾ç½®ä¸ºæ ¹è·¯å¾„
    userCookie.setMaxAge(30 * 60);         // 30åˆ†é’Ÿæœ‰æ•ˆ
    userCookie.setHttpOnly(true);          // é˜²æ­¢XSSæ”»å‡»
    
    response.addCookie(userCookie);
}
```

**ğŸ¯ æ•ˆæœå±•ç¤º**
```
è®¾ç½®åçš„è®¿é—®æ•ˆæœï¼š
âœ… www.company.com     â†’ å¯ä»¥è®¿é—®userId Cookie
âœ… hr.company.com      â†’ å¯ä»¥è®¿é—®userId Cookie  
âœ… finance.company.com â†’ å¯ä»¥è®¿é—®userId Cookie
âŒ other.com           â†’ æ— æ³•è®¿é—®userId Cookie
```

### 2.3 HTTPSç¯å¢ƒä¸‹çš„Secureå±æ€§


**ğŸ”’ å®‰å…¨Cookieè®¾ç½®**

```java
// HTTPSç¯å¢ƒä¸‹çš„å®‰å…¨Cookieè®¾ç½®
public void setSecureCookie(HttpServletResponse response) {
    Cookie secureCookie = new Cookie("token", "abc123");
    secureCookie.setDomain(".company.com");
    secureCookie.setSecure(true);    // åªåœ¨HTTPSä¸‹ä¼ è¾“
    secureCookie.setHttpOnly(true);  // ç¦æ­¢JavaScriptè®¿é—®
    secureCookie.setSameSite(Cookie.SameSite.LAX); // é˜²æ­¢CSRF
    
    response.addCookie(secureCookie);
}
```

**âš ï¸ é‡è¦æé†’**
```
ç”Ÿäº§ç¯å¢ƒå¿…å¤‡è®¾ç½®ï¼š
ğŸ”¸ setSecure(true)    â†’ Cookieåªåœ¨HTTPSä¸‹ä¼ è¾“
ğŸ”¸ setHttpOnly(true)  â†’ é˜²æ­¢XSSè„šæœ¬æ”»å‡»
ğŸ”¸ setSameSite()      â†’ é˜²æ­¢CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ 
ğŸ”¸ è®¾ç½®åˆç†è¿‡æœŸæ—¶é—´   â†’ é¿å…SessionåŠ«æŒé£é™©
```

---

## 3. ğŸ« å•ç‚¹ç™»å½•SSOæ ¸å¿ƒåŸç†


### 3.1 SSOåŸºæœ¬æ¦‚å¿µå’Œæ¶æ„


**ğŸ¢ SSOåœºæ™¯ç±»æ¯”**
> å°±åƒå…¬å¸çš„é—¨ç¦å¡ï¼Œä½ åˆ·ä¸€æ¬¡å¡è¿›å…¥å¤§æ¥¼åï¼Œå°±èƒ½è‡ªç”±è¿›å‡ºå„ä¸ªæ¥¼å±‚çš„åŠå…¬å®¤ï¼Œä¸éœ€è¦åœ¨æ¯ä¸ªé—¨å£éƒ½åˆ·ä¸€æ¬¡å¡ã€‚

**ğŸ—ï¸ SSOç³»ç»Ÿæ¶æ„å›¾**
```
                        SSOè®¤è¯ä¸­å¿ƒ
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
                    â”‚  ç»Ÿä¸€è®¤è¯æœåŠ¡å™¨  â”‚
                    â”‚  (SSO Server)   â”‚
                    â”‚                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                  â”‚                  â”‚
           â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ç³»ç»ŸA     â”‚   â”‚   ç³»ç»ŸB     â”‚   â”‚   ç³»ç»ŸC     â”‚
    â”‚  (Client)   â”‚   â”‚  (Client)   â”‚   â”‚  (Client)   â”‚
    â”‚ äººäº‹ç®¡ç†    â”‚   â”‚ è´¢åŠ¡ç®¡ç†    â”‚   â”‚ é¡¹ç›®ç®¡ç†    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ æ ¸å¿ƒç»„ä»¶è¯´æ˜**
```
ğŸ”¸ SSO Serverï¼ˆè®¤è¯ä¸­å¿ƒï¼‰ï¼š
  - è´Ÿè´£ç”¨æˆ·èº«ä»½éªŒè¯
  - ç®¡ç†ç”¨æˆ·ç™»å½•çŠ¶æ€
  - ç”Ÿæˆå’ŒéªŒè¯è®¤è¯ç¥¨æ®

ğŸ”¸ Client Applicationï¼ˆå®¢æˆ·ç«¯åº”ç”¨ï¼‰ï¼š
  - å„ä¸ªä¸šåŠ¡ç³»ç»Ÿ
  - ä¿¡ä»»SSO Serverçš„è®¤è¯ç»“æœ
  - æ¥å—SSO Serveråˆ†å‘çš„ç”¨æˆ·ä¿¡æ¯
```

### 3.2 SSOç™»å½•æµç¨‹è¯¦è§£


**ğŸ“‹ å®Œæ•´ç™»å½•æ—¶åºå›¾**
```
ç”¨æˆ·          ç³»ç»ŸA          SSOè®¤è¯ä¸­å¿ƒ        ç³»ç»ŸB
 â”‚              â”‚                â”‚             â”‚
 â”‚â”€â”è®¿é—®ç³»ç»ŸA    â”‚                â”‚             â”‚
 â”‚ â”‚           â”‚                â”‚             â”‚
 â”‚â—„â”˜           â”‚                â”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚ æ£€æŸ¥ç™»å½•çŠ¶æ€      â”‚             â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚ å‘ç°æœªç™»å½•     â”‚               â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚ é‡å®šå‘åˆ°SSO   â”‚               â”‚
 â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚  æ˜¾ç¤ºç™»å½•é¡µé¢  â”‚               â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚ è¾“å…¥ç”¨æˆ·åå¯†ç  â”‚                â”‚             â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚      éªŒè¯æˆåŠŸ   â”‚             â”‚
 â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚ ç”Ÿæˆè®¤è¯ç¥¨æ®   â”‚               â”‚
 â”‚              â”‚     (Token)   â”‚               â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚ è¿”å›ç³»ç»ŸAå¹¶     â”‚               â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚              â”‚  æºå¸¦Token     â”‚               â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚ éªŒè¯Token     â”‚               â”‚
 â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚ Tokenæœ‰æ•ˆ     â”‚               â”‚
 â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚  ç™»å½•æˆåŠŸ      â”‚             â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚             â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚ è®¿é—®ç³»ç»ŸB     â”‚                â”‚             â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚               â”‚   æ£€æŸ¥ç™»å½•çŠ¶æ€â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚               â”‚  é‡å®šå‘åˆ°SSO â”‚
 â”‚              â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚     æ£€æŸ¥è®¤è¯   â”‚               â”‚
 â”‚              â”‚    çŠ¶æ€(å·²ç™»å½•) â”‚               â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚               â”‚  ç›´æ¥è¿”å›   â”‚
 â”‚              â”‚               â”‚   Token    â”‚
 â”‚              â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚               â”‚  ç™»å½•æˆåŠŸ   â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 3.3 åŸºç¡€SSOå®ç°ç¤ºä¾‹


**ğŸ”§ SSO Serveræ ¸å¿ƒä»£ç **

```java
@Controller
@RequestMapping("/sso")
public class SSOController {
    
    // ç»Ÿä¸€ç™»å½•å…¥å£
    @RequestMapping("/login")
    public String login(@RequestParam String returnUrl, 
                       HttpSession session, 
                       Model model) {
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
        if (session.getAttribute("user") != null) {
            // å·²ç™»å½•ï¼Œç”Ÿæˆç¥¨æ®å¹¶é‡å®šå‘
            String ticket = generateTicket(session);
            return "redirect:" + returnUrl + "?ticket=" + ticket;
        }
        
        // æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•é¡µé¢
        model.addAttribute("returnUrl", returnUrl);
        return "login";
    }
    
    // å¤„ç†ç™»å½•éªŒè¯
    @PostMapping("/authenticate")
    public String authenticate(@RequestParam String username,
                             @RequestParam String password,
                             @RequestParam String returnUrl,
                             HttpSession session) {
        
        // éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        if (userService.validate(username, password)) {
            // ç™»å½•æˆåŠŸï¼Œåœ¨SSO Serverä¸­è®°å½•ç”¨æˆ·ä¿¡æ¯
            session.setAttribute("user", username);
            
            // ç”Ÿæˆç¥¨æ®
            String ticket = generateTicket(session);
            
            // é‡å®šå‘åˆ°åŸå§‹ç³»ç»Ÿå¹¶æºå¸¦ç¥¨æ®
            return "redirect:" + returnUrl + "?ticket=" + ticket;
        }
        
        return "login"; // ç™»å½•å¤±è´¥
    }
    
    // éªŒè¯ç¥¨æ®æ¥å£ï¼ˆä¾›å„ç³»ç»Ÿè°ƒç”¨ï¼‰
    @RequestMapping("/validate")
    @ResponseBody
    public Map<String, Object> validateTicket(@RequestParam String ticket) {
        Map<String, Object> result = new HashMap<>();
        
        // éªŒè¯ç¥¨æ®æœ‰æ•ˆæ€§
        String username = ticketService.validateAndConsume(ticket);
        if (username != null) {
            result.put("valid", true);
            result.put("username", username);
        } else {
            result.put("valid", false);
        }
        
        return result;
    }
    
    // ç”Ÿæˆä¸´æ—¶ç¥¨æ®
    private String generateTicket(HttpSession session) {
        String username = (String) session.getAttribute("user");
        // ç”Ÿæˆä¸´æ—¶ç¥¨æ®ï¼ˆå®é™…é¡¹ç›®ä¸­ä¼šæ›´å¤æ‚ï¼‰
        return ticketService.generateTicket(username);
    }
}
```

**ğŸ¯ å®¢æˆ·ç«¯ç³»ç»Ÿé›†æˆ**

```java
@Component
public class SSOFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨æœ¬ç³»ç»Ÿç™»å½•
        if (req.getSession().getAttribute("user") != null) {
            chain.doFilter(request, response); // å·²ç™»å½•ï¼Œç»§ç»­å¤„ç†
            return;
        }
        
        // æ£€æŸ¥æ˜¯å¦æºå¸¦SSOç¥¨æ®
        String ticket = req.getParameter("ticket");
        if (ticket != null) {
            // éªŒè¯ç¥¨æ®
            Map<String, Object> result = ssoClient.validateTicket(ticket);
            if ((Boolean) result.get("valid")) {
                // ç¥¨æ®æœ‰æ•ˆï¼Œåœ¨æœ¬ç³»ç»Ÿä¸­å»ºç«‹Session
                req.getSession().setAttribute("user", result.get("username"));
                chain.doFilter(request, response);
                return;
            }
        }
        
        // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°SSOç™»å½•é¡µé¢
        String returnUrl = req.getRequestURL().toString();
        String ssoLoginUrl = "http://sso.company.com/sso/login?returnUrl=" + returnUrl;
        resp.sendRedirect(ssoLoginUrl);
    }
}
```

---

## 4. ğŸ” OAuth2è®¤è¯æµç¨‹å®æˆ˜


### 4.1 OAuth2åŸºæœ¬æ¦‚å¿µ


**ğŸ¤ OAuth2ç”Ÿæ´»åœºæ™¯ç±»æ¯”**
> ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªæ–°çš„è®°è´¦APPï¼Œä½†ä¸æƒ³é‡æ–°æ³¨å†Œè´¦æˆ·ã€‚è¿™ä¸ªAPPæ”¯æŒ"å¾®ä¿¡ç™»å½•"ï¼Œäºæ˜¯ï¼š
> 1. ä½ ç‚¹å‡»"å¾®ä¿¡ç™»å½•"
> 2. è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µé¢ï¼Œå¾®ä¿¡é—®ä½ ï¼š"è®°è´¦APPæƒ³è·å–ä½ çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒæ„å—ï¼Ÿ"
> 3. ä½ ç‚¹å‡»"åŒæ„"
> 4. å¾®ä¿¡å‘Šè¯‰è®°è´¦APPï¼š"è¿™ä¸ªç”¨æˆ·åŒæ„äº†ï¼Œç»™ä½ ä¸€ä¸ªtoken"
> 5. è®°è´¦APPç”¨è¿™ä¸ªtokenä»å¾®ä¿¡è·å–ä½ çš„ä¿¡æ¯ï¼Œå®Œæˆç™»å½•
> 
> æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè®°è´¦APPä»æ¥æ²¡æœ‰ç¢°åˆ°ä½ çš„å¾®ä¿¡å¯†ç ï¼

**ğŸ“ OAuth2å››ä¸ªè§’è‰²**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                OAuth2 å››å¤§è§’è‰²                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ‘¤ Resource Owner (èµ„æºæ‹¥æœ‰è€…)                     â”‚
â”‚      â””â”€ å°±æ˜¯ç”¨æˆ·ï¼Œæ‹¥æœ‰åœ¨æˆæƒæœåŠ¡å™¨ä¸Šçš„è´¦æˆ·           â”‚
â”‚                                                     â”‚
â”‚  ğŸ“± Client (å®¢æˆ·ç«¯)                                â”‚
â”‚      â””â”€ ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæƒ³è¦è®¿é—®ç”¨æˆ·èµ„æº                â”‚
â”‚                                                     â”‚
â”‚  ğŸ›ï¸ Authorization Server (æˆæƒæœåŠ¡å™¨)              â”‚
â”‚      â””â”€ è´Ÿè´£è®¤è¯ç”¨æˆ·èº«ä»½ï¼Œé¢å‘è®¿é—®ä»¤ç‰Œ               â”‚
â”‚                                                     â”‚
â”‚  ğŸ’¾ Resource Server (èµ„æºæœåŠ¡å™¨)                   â”‚
â”‚      â””â”€ å­˜å‚¨ç”¨æˆ·èµ„æºï¼Œæ¥å—tokenè®¿é—®                 â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æˆæƒç æ¨¡å¼è¯¦è§£


**ğŸ“‹ æˆæƒç æ¨¡å¼æµç¨‹å›¾**
```
ç”¨æˆ·(æµè§ˆå™¨)    ç¬¬ä¸‰æ–¹åº”ç”¨       æˆæƒæœåŠ¡å™¨        èµ„æºæœåŠ¡å™¨
     â”‚            â”‚               â”‚                â”‚
     â”‚ 1.ç‚¹å‡»ç™»å½•   â”‚               â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                â”‚
     â”‚            â”‚               â”‚                â”‚
     â”‚            â”‚ 2.é‡å®šå‘åˆ°     â”‚                â”‚
     â”‚            â”‚   æˆæƒé¡µé¢     â”‚                â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
     â”‚            â”‚               â”‚                â”‚
     â”‚ 3.ç”¨æˆ·æˆæƒ  â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
     â”‚            â”‚               â”‚                â”‚
     â”‚            â”‚ 4.è¿”å›æˆæƒç    â”‚                â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚            â”‚               â”‚                â”‚
     â”‚            â”‚ 5.ç”¨æˆæƒç      â”‚                â”‚
     â”‚            â”‚   æ¢å–token   â”‚                â”‚
     â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
     â”‚            â”‚               â”‚                â”‚
     â”‚            â”‚ 6.è¿”å›token   â”‚                â”‚
     â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚            â”‚               â”‚                â”‚
     â”‚            â”‚ 7.ç”¨token      â”‚                â”‚
     â”‚            â”‚   è®¿é—®èµ„æº     â”‚                â”‚
     â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚            â”‚               â”‚                â”‚
     â”‚            â”‚ 8.è¿”å›ç”¨æˆ·ä¿¡æ¯  â”‚                â”‚
     â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚            â”‚               â”‚                â”‚
     â”‚ 9.ç™»å½•æˆåŠŸ  â”‚                â”‚                â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚
```

### 4.3 Spring Security OAuth2å®ç°


**ğŸ› ï¸ OAuth2å®¢æˆ·ç«¯é…ç½®**

```java
// OAuth2é…ç½®ç±»
@Configuration
@EnableWebSecurity
public class OAuth2Config extends WebSecurityConfigurerAdapter {
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers("/", "/login**").permitAll()
                .anyRequest().authenticated()
            .and()
            .oauth2Login()
                .loginPage("/login")
                .defaultSuccessUrl("/home")
                .failureUrl("/login?error");
    }
}
```

**âš™ï¸ application.ymlé…ç½®**

```yaml
spring:
  security:
    oauth2:
      client:
        registration:
          # GitHub OAuth2é…ç½®
          github:
            client-id: your-github-client-id
            client-secret: your-github-client-secret
            scope: read:user,user:email
          
          # å¾®ä¿¡OAuth2é…ç½®  
          wechat:
            client-id: your-wechat-app-id
            client-secret: your-wechat-app-secret
            authorization-grant-type: authorization_code
            redirect-uri: http://localhost:8080/login/oauth2/code/wechat
            scope: snsapi_userinfo
        
        provider:
          wechat:
            authorization-uri: https://open.weixin.qq.com/connect/oauth2/authorize
            token-uri: https://api.weixin.qq.com/sns/oauth2/access_token
            user-info-uri: https://api.weixin.qq.com/sns/userinfo
            user-name-attribute: openid
```

**ğŸ¯ ç™»å½•å¤„ç†æ§åˆ¶å™¨**

```java
@Controller
public class OAuth2LoginController {
    
    // OAuth2ç™»å½•æˆåŠŸåçš„å¤„ç†
    @RequestMapping("/home")
    public String home(Model model, OAuth2AuthenticationToken authentication) {
        
        // è·å–ç”¨æˆ·ä¿¡æ¯
        OAuth2User oauth2User = authentication.getPrincipal();
        
        // æ ¹æ®ä¸åŒçš„OAuth2æä¾›å•†å¤„ç†ç”¨æˆ·ä¿¡æ¯
        String provider = authentication.getAuthorizedClientRegistrationId();
        
        if ("github".equals(provider)) {
            handleGitHubUser(oauth2User, model);
        } else if ("wechat".equals(provider)) {
            handleWeChatUser(oauth2User, model);
        }
        
        return "home";
    }
    
    private void handleGitHubUser(OAuth2User oauth2User, Model model) {
        String name = oauth2User.getAttribute("name");
        String email = oauth2User.getAttribute("email");
        String avatarUrl = oauth2User.getAttribute("avatar_url");
        
        model.addAttribute("name", name);
        model.addAttribute("email", email);
        model.addAttribute("avatar", avatarUrl);
    }
    
    private void handleWeChatUser(OAuth2User oauth2User, Model model) {
        String nickname = oauth2User.getAttribute("nickname");
        String headimgurl = oauth2User.getAttribute("headimgurl");
        
        model.addAttribute("name", nickname);
        model.addAttribute("avatar", headimgurl);
    }
}
```

---

## 5. ğŸ›ï¸ CASç»Ÿä¸€è®¤è¯ç³»ç»Ÿ


### 5.1 CASåŸºæœ¬æ¶æ„


**ğŸ¢ CASç³»ç»Ÿç»„æˆ**
```
                    CAS Server
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                         â”‚
            â”‚    ç»Ÿä¸€è®¤è¯æœåŠ¡å™¨       â”‚
            â”‚                         â”‚
            â”‚  ğŸ” ç”¨æˆ·éªŒè¯             â”‚
            â”‚  ğŸ« ç¥¨æ®ç”Ÿæˆ             â”‚  
            â”‚  âœ… ç¥¨æ®éªŒè¯             â”‚
            â”‚  ğŸ“Š ä¼šè¯ç®¡ç†             â”‚
            â”‚                         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚              â”‚
       â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨A     â”‚ â”‚   åº”ç”¨B     â”‚ â”‚   åº”ç”¨C     â”‚
â”‚ CAS Client  â”‚ â”‚ CAS Client  â”‚ â”‚ CAS Client  â”‚
â”‚             â”‚ â”‚             â”‚ â”‚             â”‚
â”‚ ğŸŒ Webåº”ç”¨  â”‚ â”‚ ğŸ“Š ç®¡ç†åå°  â”‚ â”‚ ğŸ“± ç§»åŠ¨æ¥å£  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 CASè®¤è¯ç¥¨æ®ç±»å‹


**ğŸ« CASç¥¨æ®ä½“ç³»**

| ç¥¨æ®ç±»å‹ | **è‹±æ–‡åç§°** | **ä½œç”¨è¯´æ˜** | **ç”Ÿå‘½å‘¨æœŸ** | **ä½¿ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|-------------|
| ğŸª **TGT** | `Ticket Granting Ticket` | `å…¨å±€ä¼šè¯ç¥¨æ®ï¼Œè¯æ˜ç”¨æˆ·å·²è®¤è¯` | `è¾ƒé•¿(å¦‚8å°æ—¶)` | `SSOä¼šè¯ä¿æŒ` |
| ğŸŸï¸ **ST** | `Service Ticket` | `æœåŠ¡ç¥¨æ®ï¼Œä¸€æ¬¡æ€§ä½¿ç”¨` | `å¾ˆçŸ­(å¦‚5åˆ†é’Ÿ)` | `åº”ç”¨é—´è·³è½¬è®¤è¯` |
| ğŸ« **PGT** | `Proxy Granting Ticket` | `ä»£ç†ç¥¨æ®ï¼Œç”¨äºåº”ç”¨ä»£ç†` | `ä¸­ç­‰(å¦‚2å°æ—¶)` | `åº”ç”¨é—´APIè°ƒç”¨` |
| ğŸ­ **PT** | `Proxy Ticket` | `ä»£ç†æœåŠ¡ç¥¨æ®` | `å¾ˆçŸ­(å¦‚1åˆ†é’Ÿ)` | `åç«¯æœåŠ¡è®¤è¯` |

### 5.3 CASå®Œæ•´è®¤è¯æµç¨‹


**ğŸ“‹ è¯¦ç»†è®¤è¯æ—¶åº**
```
ç”¨æˆ·          åº”ç”¨A          CAS Server        åº”ç”¨B
 â”‚              â”‚                â”‚             â”‚
 â”‚ 1.è®¿é—®åº”ç”¨A   â”‚                â”‚             â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚ 2.æ£€æŸ¥TGC      â”‚               â”‚
 â”‚              â”‚   Cookie       â”‚               â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚ 3.æœªå‘ç°TGC    â”‚               â”‚
 â”‚              â”‚   é‡å®šå‘åˆ°CAS   â”‚               â”‚
 â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚ 4.æ˜¾ç¤ºç™»å½•é¡µé¢ â”‚                â”‚             â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚ 5.è¾“å…¥ç”¨æˆ·åå¯†ç  â”‚                â”‚             â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚     6.éªŒè¯æˆåŠŸ   â”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚  7.ç”ŸæˆTGTå¹¶    â”‚               â”‚
 â”‚              â”‚    è®¾ç½®TGC     â”‚               â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚  8.ç”ŸæˆSTç¥¨æ®   â”‚               â”‚
 â”‚              â”‚    é‡å®šå‘å›åº”ç”¨A â”‚               â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚ 9.æºå¸¦STè®¿é—®   â”‚               â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚ 10.éªŒè¯ST      â”‚               â”‚
 â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚ 11.è¿”å›ç”¨æˆ·ä¿¡æ¯ â”‚               â”‚
 â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚              â”‚ 12.å»ºç«‹Session â”‚               â”‚
 â”‚              â”‚    ç™»å½•æˆåŠŸ     â”‚               â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚             â”‚
 â”‚              â”‚                â”‚             â”‚
 â”‚ 13.è®¿é—®åº”ç”¨B  â”‚                â”‚             â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚               â”‚ 14.æ£€æŸ¥ç™»å½• â”‚
 â”‚              â”‚               â”‚  é‡å®šå‘CAS  â”‚
 â”‚              â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚    15.å‘ç°TGC   â”‚               â”‚
 â”‚              â”‚      å·²å­˜åœ¨     â”‚               â”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚   16.ç›´æ¥ç”ŸæˆST â”‚               â”‚
 â”‚              â”‚     é‡å®šå‘åº”ç”¨B â”‚               â”‚
 â”‚              â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚               â”‚ 17.éªŒè¯ST  â”‚
 â”‚              â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚              â”‚               â”‚             â”‚
 â”‚              â”‚               â”‚18.ç™»å½•æˆåŠŸ â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 5.4 CASå®¢æˆ·ç«¯é›†æˆå®ç°


**ğŸ”§ CAS Filteré…ç½®**

```java
// CASè®¤è¯è¿‡æ»¤å™¨é…ç½®
@Configuration
public class CASConfig {
    
    @Value("${cas.server.url}")
    private String casServerUrl;
    
    @Value("${cas.client.url}")
    private String casClientUrl;
    
    // CASè®¤è¯è¿‡æ»¤å™¨
    @Bean
    public FilterRegistrationBean casAuthenticationFilter() {
        FilterRegistrationBean registration = new FilterRegistrationBean();
        registration.setFilter(new AuthenticationFilter());
        registration.addUrlPatterns("/*");
        registration.setName("CAS Authentication Filter");
        registration.setOrder(1);
        
        registration.addInitParameter("casServerLoginUrl", 
            casServerUrl + "/login");
        registration.addInitParameter("serverName", casClientUrl);
        
        return registration;
    }
    
    // CASç¥¨æ®éªŒè¯è¿‡æ»¤å™¨
    @Bean
    public FilterRegistrationBean casValidationFilter() {
        FilterRegistrationBean registration = new FilterRegistrationBean();
        registration.setFilter(new Cas20ProxyReceivingTicketValidationFilter());
        registration.addUrlPatterns("/*");
        registration.setName("CAS Validation Filter");
        registration.setOrder(2);
        
        registration.addInitParameter("casServerUrlPrefix", casServerUrl);
        registration.addInitParameter("serverName", casClientUrl);
        
        return registration;
    }
}
```

**ğŸ¯ CASç”¨æˆ·ä¿¡æ¯è·å–**

```java
@Controller
public class UserController {
    
    // è·å–å½“å‰CASè®¤è¯ç”¨æˆ·ä¿¡æ¯
    @RequestMapping("/userinfo")
    @ResponseBody
    public Map<String, Object> getCurrentUser(HttpServletRequest request) {
        Map<String, Object> userInfo = new HashMap<>();
        
        // ä»CASå±æ€§ä¸­è·å–ç”¨æˆ·ä¿¡æ¯
        AttributePrincipal principal = 
            (AttributePrincipal) request.getUserPrincipal();
            
        if (principal != null) {
            // è·å–ç”¨æˆ·å
            userInfo.put("username", principal.getName());
            
            // è·å–ç”¨æˆ·æ‰©å±•å±æ€§
            Map<String, Object> attributes = principal.getAttributes();
            userInfo.put("realName", attributes.get("cn"));
            userInfo.put("email", attributes.get("email"));
            userInfo.put("department", attributes.get("department"));
        }
        
        return userInfo;
    }
    
    // CASå•ç‚¹ç™»å‡º
    @RequestMapping("/logout")
    public String logout(HttpServletRequest request) {
        // æ¸…ç†æœ¬åœ°Session
        request.getSession().invalidate();
        
        // é‡å®šå‘åˆ°CAS Serverç™»å‡º
        String casLogoutUrl = casServerUrl + "/logout" + 
                            "?service=" + casClientUrl;
        return "redirect:" + casLogoutUrl;
    }
}
```

---

## 6. ğŸ”— è·¨ç³»ç»Ÿä¼šè¯å…±äº«æ–¹æ¡ˆ


### 6.1 åŸºäºRedisçš„é›†ä¸­å¼Sessionå­˜å‚¨


**ğŸ—‚ï¸ Redis Sessionå…±äº«æ¶æ„**
```
        åº”ç”¨æœåŠ¡å™¨é›†ç¾¤
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”      â”‚
    â”‚  â”‚App1 â”‚  â”‚App2 â”‚ ...  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚      â”‚        â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         â”‚
                    â–¼         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚
            â”‚    Redisé›†ç¾¤        â”‚
            â”‚  Sessionå…±äº«å­˜å‚¨    â”‚
            â”‚                     â”‚
            â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”     â”‚
            â”‚ â”‚ä¸»èŠ‚ç‚¹â”‚ â”‚ä»èŠ‚ç‚¹â”‚    â”‚
            â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ› ï¸ Spring Session Redisé…ç½®**

```java
// Redis Sessioné…ç½®ç±»
@EnableRedisHttpSession(
    maxInactiveIntervalInSeconds = 1800, // 30åˆ†é’Ÿè¿‡æœŸ
    redisNamespace = "company:session"   // Sessionå‘½åç©ºé—´
)
@Configuration
public class RedisSessionConfig {
    
    @Bean
    public JedisConnectionFactory connectionFactory() {
        JedisConnectionFactory factory = new JedisConnectionFactory();
        factory.setHostName("redis.company.com");
        factory.setPort(6379);
        factory.setPassword("your-redis-password");
        factory.setDatabase(0);
        return factory;
    }
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate() {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(connectionFactory());
        
        // è®¾ç½®åºåˆ—åŒ–æ–¹å¼
        template.setDefaultSerializer(new GenericJackson2JsonRedisSerializer());
        template.setKeySerializer(new StringRedisSerializer());
        
        return template;
    }
}
```

**ğŸ’¡ Sessionæ“ä½œç¤ºä¾‹**

```java
@RestController
public class SessionController {
    
    // è®¾ç½®Sessionä¿¡æ¯
    @PostMapping("/session/set")
    public Map<String, Object> setSession(HttpServletRequest request,
                                         @RequestBody UserInfo userInfo) {
        HttpSession session = request.getSession();
        
        // å­˜å‚¨ç”¨æˆ·ä¿¡æ¯åˆ°Sessionï¼ˆè‡ªåŠ¨å­˜å‚¨åˆ°Redisï¼‰
        session.setAttribute("userInfo", userInfo);
        session.setAttribute("loginTime", new Date());
        session.setAttribute("permissions", getUserPermissions(userInfo.getId()));
        
        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("sessionId", session.getId());
        result.put("message", "Sessionä¿¡æ¯å·²ä¿å­˜åˆ°Redis");
        
        return result;
    }
    
    // è·å–Sessionä¿¡æ¯
    @GetMapping("/session/get")
    public Map<String, Object> getSession(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        Map<String, Object> result = new HashMap<>();
        
        if (session != null) {
            UserInfo userInfo = (UserInfo) session.getAttribute("userInfo");
            Date loginTime = (Date) session.getAttribute("loginTime");
            
            result.put("userInfo", userInfo);
            result.put("loginTime", loginTime);
            result.put("sessionId", session.getId());
            result.put("maxInactiveInterval", session.getMaxInactiveInterval());
        } else {
            result.put("message", "Sessionä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ");
        }
        
        return result;
    }
}
```

### 6.2 JWTæ— çŠ¶æ€Tokenæ–¹æ¡ˆ


**ğŸ« JWT Tokenç»“æ„è§£æ**
```
JWT Token ç»„æˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JWT Token                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Header      â”‚      Payload      â”‚     Signature     â”‚
â”‚   (å¤´éƒ¨ä¿¡æ¯)     â”‚    (è½½è·æ•°æ®)     â”‚     (ç­¾åéªŒè¯)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {               â”‚ {                 â”‚                   â”‚
â”‚   "typ":"JWT",  â”‚   "sub":"12345",  â”‚   HMACSHA256(     â”‚
â”‚   "alg":"HS256" â”‚   "name":"å¼ ä¸‰",   â”‚     base64Url     â”‚
â”‚ }               â”‚   "iat":1609459200â”‚     (header) +    â”‚
â”‚                 â”‚ }                 â”‚     "." +         â”‚
â”‚                 â”‚                   â”‚     base64Url     â”‚
â”‚                 â”‚                   â”‚     (payload),    â”‚
â”‚                 â”‚                   â”‚     secret)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ JWTå·¥å…·ç±»å®ç°**

```java
@Component
public class JWTTokenUtil {
    
    @Value("${jwt.secret}")
    private String secret;
    
    @Value("${jwt.expiration}")
    private Long expiration;
    
    // ç”ŸæˆJWT Token
    public String generateToken(UserDetails userDetails) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("username", userDetails.getUsername());
        claims.put("authorities", userDetails.getAuthorities());
        return generateToken(claims, userDetails.getUsername());
    }
    
    private String generateToken(Map<String, Object> claims, String subject) {
        Date now = new Date();
        Date expiryDate = new Date(now.getTime() + expiration * 1000);
        
        return Jwts.builder()
                .setClaims(claims)
                .setSubject(subject)
                .setIssuedAt(now)
                .setExpiration(expiryDate)
                .signWith(SignatureAlgorithm.HS256, secret)
                .compact();
    }
    
    // ä»Tokenä¸­è·å–ç”¨æˆ·å
    public String getUsernameFromToken(String token) {
        return getClaimFromToken(token, Claims::getSubject);
    }
    
    // è·å–Tokenè¿‡æœŸæ—¶é—´
    public Date getExpirationDateFromToken(String token) {
        return getClaimFromToken(token, Claims::getExpiration);
    }
    
    // éªŒè¯Tokenæ˜¯å¦æœ‰æ•ˆ
    public Boolean validateToken(String token, UserDetails userDetails) {
        final String username = getUsernameFromToken(token);
        return (username.equals(userDetails.getUsername()) && 
                !isTokenExpired(token));
    }
    
    // æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ
    private Boolean isTokenExpired(String token) {
        final Date expiration = getExpirationDateFromToken(token);
        return expiration.before(new Date());
    }
    
    private <T> T getClaimFromToken(String token, Function<Claims, T> claimsResolver) {
        final Claims claims = getAllClaimsFromToken(token);
        return claimsResolver.apply(claims);
    }
    
    private Claims getAllClaimsFromToken(String token) {
        return Jwts.parser()
                .setSigningKey(secret)
                .parseClaimsJws(token)
                .getBody();
    }
}
```

**ğŸ” JWTè®¤è¯è¿‡æ»¤å™¨**

```java
@Component
public class JWTAuthenticationFilter extends OncePerRequestFilter {
    
    @Autowired
    private UserDetailsService userDetailsService;
    
    @Autowired
    private JWTTokenUtil jwtTokenUtil;
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                   HttpServletResponse response, 
                                   FilterChain chain) 
            throws ServletException, IOException {
        
        // è·å–Authorizationå¤´
        String authHeader = request.getHeader("Authorization");
        
        String username = null;
        String token = null;
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºBearer Tokenæ ¼å¼
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            token = authHeader.substring(7); // å»æ‰"Bearer "å‰ç¼€
            try {
                username = jwtTokenUtil.getUsernameFromToken(token);
            } catch (Exception e) {
                logger.error("JWT Tokenè§£æå¤±è´¥: " + e.getMessage());
            }
        }
        
        // éªŒè¯Tokenå¹¶è®¾ç½®Authentication
        if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {
            UserDetails userDetails = userDetailsService.loadUserByUsername(username);
            
            if (jwtTokenUtil.validateToken(token, userDetails)) {
                // Tokenæœ‰æ•ˆï¼Œè®¾ç½®ç”¨æˆ·è®¤è¯ä¿¡æ¯
                UsernamePasswordAuthenticationToken authToken = 
                    new UsernamePasswordAuthenticationToken(
                        userDetails, null, userDetails.getAuthorities());
                authToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                
                SecurityContextHolder.getContext().setAuthentication(authToken);
            }
        }
        
        chain.doFilter(request, response);
    }
}
```

### 6.3 JWT vs Sessionå¯¹æ¯”


**âš–ï¸ æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**

| å¯¹æ¯”ç»´åº¦ | **Session + Redis** | **JWT Token** | **æœ€ä½³é€‰æ‹©å»ºè®®** |
|---------|-------------------|---------------|-----------------|
| **ğŸ—ï¸ æ¶æ„å¤æ‚åº¦** | `éœ€è¦Redisé›†ç¾¤ç»´æŠ¤` | `æ— éœ€é¢å¤–å­˜å‚¨` | `å°é¡¹ç›®é€‰JWTï¼Œå¤§é¡¹ç›®é€‰Redis` |
| **ğŸ“Š æ€§èƒ½è¡¨ç°** | `éœ€è¦ç½‘ç»œIOæŸ¥è¯¢` | `æœ¬åœ°è§£æéªŒè¯` | `é«˜å¹¶å‘åœºæ™¯JWTæ›´å¥½` |
| **ğŸ”’ å®‰å…¨æ€§** | `æœåŠ¡å™¨å¯æ§ï¼Œå¯éšæ—¶æ’¤é”€` | `æ— æ³•ä¸»åŠ¨å¤±æ•ˆ` | `é«˜å®‰å…¨è¦æ±‚é€‰Session` |
| **ğŸ“± ç§»åŠ¨ç«¯é€‚é…** | `éœ€è¦Cookieæ”¯æŒ` | `å¤©ç„¶æ”¯æŒ` | `ç§»åŠ¨ç«¯APIé€‰JWT` |
| **ğŸ’¾ å­˜å‚¨å ç”¨** | `æœåŠ¡å™¨å†…å­˜å ç”¨` | `å®¢æˆ·ç«¯å­˜å‚¨` | `ç”¨æˆ·å¤šé€‰JWT` |
| **ğŸ”„ æ‰©å±•æ€§** | `éœ€è¦SessionåŒæ­¥` | `å¤©ç„¶æ— çŠ¶æ€` | `åˆ†å¸ƒå¼ç³»ç»Ÿé€‰JWT` |

---

## 7. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ


### 7.1 ä¼ä¸šå†…éƒ¨ç³»ç»Ÿæ•´åˆ


**ğŸ¢ ä¼ä¸šçº§SSOè§£å†³æ–¹æ¡ˆ**

```
ä¼ä¸šåœºæ™¯ï¼šæŸå…¬å¸æœ‰10ä¸ªå†…éƒ¨ç³»ç»Ÿéœ€è¦ç»Ÿä¸€ç™»å½•

ç³»ç»Ÿæ¸…å•ï¼š
â”œâ”€â”€ äººåŠ›èµ„æºç®¡ç†ç³»ç»Ÿ (hr.company.com)
â”œâ”€â”€ è´¢åŠ¡ç®¡ç†ç³»ç»Ÿ (finance.company.com)  
â”œâ”€â”€ é¡¹ç›®ç®¡ç†ç³»ç»Ÿ (pm.company.com)
â”œâ”€â”€ å®¢æˆ·å…³ç³»ç®¡ç† (crm.company.com)
â”œâ”€â”€ åŠå…¬è‡ªåŠ¨åŒ– (oa.company.com)
â”œâ”€â”€ ä¼ä¸šé‚®ç®± (mail.company.com)
â”œâ”€â”€ æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ (doc.company.com)
â”œâ”€â”€ è§†é¢‘ä¼šè®®ç³»ç»Ÿ (meeting.company.com)
â”œâ”€â”€ æŠ¥è¡¨åˆ†æç³»ç»Ÿ (bi.company.com)
â””â”€â”€ è®¾å¤‡ç®¡ç†ç³»ç»Ÿ (device.company.com)

æŠ€æœ¯é€‰å‹å»ºè®®ï¼š
âœ… æ¨èæ–¹æ¡ˆï¼šCAS + LDAP
åŸå› ï¼šä¼ä¸šå†…éƒ¨ç³»ç»Ÿï¼Œå®‰å…¨è¦æ±‚é«˜ï¼Œéœ€è¦ç»Ÿä¸€ç”¨æˆ·ç®¡ç†
```

**ğŸ”§ å®ç°æ¶æ„è®¾è®¡**

```java
// ä¼ä¸šSSOé…ç½®ä¸­å¿ƒ
@Configuration
public class EnterpriseSSO {
    
    // ç³»ç»Ÿæ³¨å†Œè¡¨
    private static final Map<String, String> SYSTEM_REGISTRY = Map.of(
        "hr", "https://hr.company.com",
        "finance", "https://finance.company.com",
        "pm", "https://pm.company.com",
        "crm", "https://crm.company.com"
        // ... å…¶ä»–ç³»ç»Ÿ
    );
    
    // ç”¨æˆ·æƒé™çŸ©é˜µ
    @Bean
    public UserPermissionMatrix permissionMatrix() {
        return UserPermissionMatrix.builder()
            .addRole("ç®¡ç†å‘˜", ALL_SYSTEMS)
            .addRole("è´¢åŠ¡", List.of("finance", "oa"))
            .addRole("HR", List.of("hr", "oa"))
            .addRole("é¡¹ç›®ç»ç†", List.of("pm", "crm", "oa"))
            .build();
    }
}
```

### 7.2 ç”µå•†å¹³å°å¤šåŸŸåæ•´åˆ


**ğŸ›’ ç”µå•†åœºæ™¯åˆ†æ**
```
ç”µå•†å¹³å°å¤šç«™ç‚¹åœºæ™¯ï¼š

ä¸»ç«™ï¼šwww.shop.com        (å•†å“å±•ç¤º)
ç”¨æˆ·ä¸­å¿ƒï¼šuser.shop.com   (ä¸ªäººä¿¡æ¯)
è®¢å•ç³»ç»Ÿï¼šorder.shop.com  (è®¢å•ç®¡ç†)
æ”¯ä»˜ç³»ç»Ÿï¼špay.shop.com    (æ”¯ä»˜å¤„ç†)
å®¢æœç³»ç»Ÿï¼šservice.shop.com (åœ¨çº¿å®¢æœ)

æŠ€æœ¯æŒ‘æˆ˜ï¼š
ğŸ”¸ ä¸åŒå­åŸŸåéœ€è¦å…±äº«ç™»å½•çŠ¶æ€
ğŸ”¸ æ”¯ä»˜å®‰å…¨è¦æ±‚æé«˜
ğŸ”¸ ç”¨æˆ·ä½“éªŒè¦æ±‚ä¸€é”®ç™»å½•
```

**ğŸ’¡ ç”µå•†SSOå®ç°æ–¹æ¡ˆ**

```java
@Service
public class ECommerceSSO {
    
    // è·¨åŸŸCookieè®¾ç½®
    public void setSharedLoginCookie(HttpServletResponse response, 
                                   String userId, String token) {
        // ä¸»åŸŸåCookieï¼Œæ‰€æœ‰å­åŸŸåå¯è®¿é—®
        Cookie loginCookie = new Cookie("LOGIN_TOKEN", token);
        loginCookie.setDomain(".shop.com");  // å…³é”®è®¾ç½®
        loginCookie.setPath("/");
        loginCookie.setHttpOnly(true);
        loginCookie.setSecure(true); // ç”Ÿäº§ç¯å¢ƒå¿…é¡»HTTPS
        loginCookie.setMaxAge(7 * 24 * 3600); // 7å¤©æœ‰æ•ˆæœŸ
        
        response.addCookie(loginCookie);
        
        // ç”¨æˆ·ID Cookie
        Cookie userCookie = new Cookie("USER_ID", userId);
        userCookie.setDomain(".shop.com");
        userCookie.setPath("/");
        userCookie.setMaxAge(7 * 24 * 3600);
        
        response.addCookie(userCookie);
    }
    
    // ç»Ÿä¸€ç™»å½•éªŒè¯
    public boolean validateLogin(HttpServletRequest request) {
        String token = getCookieValue(request, "LOGIN_TOKEN");
        String userId = getCookieValue(request, "USER_ID");
        
        if (token == null || userId == null) {
            return false;
        }
        
        // éªŒè¯Tokenæœ‰æ•ˆæ€§
        return tokenService.validateToken(userId, token);
    }
    
    private String getCookieValue(HttpServletRequest request, String name) {
        Cookie[] cookies = request.getCookies();
        if (cookies != null) {
            for (Cookie cookie : cookies) {
                if (name.equals(cookie.getName())) {
                    return cookie.getValue();
                }
            }
        }
        return null;
    }
}
```

### 7.3 ç§»åŠ¨ç«¯APIç»Ÿä¸€è®¤è¯


**ğŸ“± ç§»åŠ¨ç«¯åœºæ™¯ç‰¹ç‚¹**
```
ç§»åŠ¨ç«¯ç‰¹æ®Šéœ€æ±‚ï¼š
ğŸ”¸ ä¸æ”¯æŒCookieæœºåˆ¶
ğŸ”¸ éœ€è¦é•¿æœŸä¿æŒç™»å½•
ğŸ”¸ æ”¯æŒå¤šè®¾å¤‡åŒæ—¶åœ¨çº¿
ğŸ”¸ ç½‘ç»œç¯å¢ƒä¸ç¨³å®š

è§£å†³æ–¹æ¡ˆï¼šJWT + Refresh Token
```

**ğŸ”§ ç§»åŠ¨ç«¯JWTè®¤è¯å®ç°**

```java
@RestController
@RequestMapping("/api/auth")
public class MobileAuthController {
    
    @Autowired
    private JWTTokenUtil jwtTokenUtil;
    
    // ç§»åŠ¨ç«¯ç™»å½•
    @PostMapping("/login")
    public ResponseEntity<AuthResponse> mobileLogin(@RequestBody LoginRequest request) {
        
        // éªŒè¯ç”¨æˆ·åå¯†ç 
        if (!userService.validateCredentials(request.getUsername(), request.getPassword())) {
            return ResponseEntity.badRequest().body(
                AuthResponse.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"));
        }
        
        UserDetails userDetails = userService.loadUserByUsername(request.getUsername());
        
        // ç”ŸæˆAccess Token (çŸ­æœŸæœ‰æ•ˆï¼Œå¦‚2å°æ—¶)
        String accessToken = jwtTokenUtil.generateToken(userDetails, Duration.ofHours(2));
        
        // ç”ŸæˆRefresh Token (é•¿æœŸæœ‰æ•ˆï¼Œå¦‚30å¤©)
        String refreshToken = jwtTokenUtil.generateRefreshToken(userDetails, Duration.ofDays(30));
        
        // ä¿å­˜Refresh Tokenåˆ°æ•°æ®åº“
        tokenService.saveRefreshToken(userDetails.getUsername(), refreshToken);
        
        return ResponseEntity.ok(AuthResponse.builder()
            .accessToken(accessToken)
            .refreshToken(refreshToken)
            .tokenType("Bearer")
            .expiresIn(7200) // 2å°æ—¶
            .build());
    }
    
    // Tokenåˆ·æ–°æ¥å£
    @PostMapping("/refresh")
    public ResponseEntity<AuthResponse> refreshToken(@RequestBody RefreshTokenRequest request) {
        
        String refreshToken = request.getRefreshToken();
        
        // éªŒè¯Refresh Token
        if (!jwtTokenUtil.validateRefreshToken(refreshToken)) {
            return ResponseEntity.badRequest().body(
                AuthResponse.error("Refresh Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ"));
        }
        
        String username = jwtTokenUtil.getUsernameFromToken(refreshToken);
        UserDetails userDetails = userService.loadUserByUsername(username);
        
        // ç”Ÿæˆæ–°çš„Access Token
        String newAccessToken = jwtTokenUtil.generateToken(userDetails, Duration.ofHours(2));
        
        return ResponseEntity.ok(AuthResponse.builder()
            .accessToken(newAccessToken)
            .tokenType("Bearer")
            .expiresIn(7200)
            .build());
    }
    
    // ç™»å‡ºæ¥å£
    @PostMapping("/logout")
    public ResponseEntity<String> logout(@RequestHeader("Authorization") String authHeader,
                                       @RequestBody LogoutRequest request) {
        
        // è§£æToken
        String accessToken = authHeader.substring(7);
        String username = jwtTokenUtil.getUsernameFromToken(accessToken);
        
        // åˆ é™¤Refresh Token
        tokenService.deleteRefreshToken(username, request.getRefreshToken());
        
        // å°†Access TokenåŠ å…¥é»‘åå•ï¼ˆå¯é€‰ï¼‰
        tokenService.blacklistToken(accessToken);
        
        return ResponseEntity.ok("ç™»å‡ºæˆåŠŸ");
    }
}
```

### 7.4 å®‰å…¨æœ€ä½³å®è·µ


**ğŸ”’ å®‰å…¨é˜²æŠ¤æ¸…å•**

```
ğŸ›¡ï¸ åŸºç¡€å®‰å…¨æªæ–½ï¼š

1. HTTPSå¼ºåˆ¶ä½¿ç”¨
   âœ… æ‰€æœ‰è®¤è¯ç›¸å…³æ¥å£å¿…é¡»HTTPS
   âœ… Cookieè®¾ç½®Secureæ ‡å¿—
   âœ… ç¦æ­¢HTTPä¸‹çš„æ•æ„Ÿæ“ä½œ

2. Tokenå®‰å…¨ç®¡ç†
   âœ… ä½¿ç”¨å¼ºéšæœºæ•°ç”ŸæˆToken
   âœ… TokenåŒ…å«è¿‡æœŸæ—¶é—´
   âœ… æ•æ„Ÿæ“ä½œéœ€è¦é‡æ–°éªŒè¯
   âœ… å®ç°Tokené»‘åå•æœºåˆ¶

3. é˜²æ­¢å¸¸è§æ”»å‡»
   âœ… é˜²CSRFï¼šTokenéªŒè¯ + SameSite Cookie
   âœ… é˜²XSSï¼šHttpOnly Cookie + å†…å®¹è½¬ä¹‰
   âœ… é˜²é‡æ”¾ï¼šè¯·æ±‚æ—¶é—´æˆ³ + nonce
   âœ… é˜²æš´åŠ›ç ´è§£ï¼šç™»å½•æ¬¡æ•°é™åˆ¶ + éªŒè¯ç 
```

**ğŸ”§ å®‰å…¨ç»„ä»¶å®ç°**

```java
@Component
public class SecurityEnforcer {
    
    // ç™»å½•æ¬¡æ•°é™åˆ¶
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    public boolean checkLoginAttempts(String username, String clientIp) {
        String key = "login_attempts:" + username + ":" + clientIp;
        Integer attempts = (Integer) redisTemplate.opsForValue().get(key);
        
        if (attempts != null && attempts >= 5) {
            // è¶…è¿‡5æ¬¡å¤±è´¥ï¼Œé”å®š30åˆ†é’Ÿ
            return false;
        }
        return true;
    }
    
    public void recordFailedLogin(String username, String clientIp) {
        String key = "login_attempts:" + username + ":" + clientIp;
        redisTemplate.opsForValue().increment(key);
        redisTemplate.expire(key, Duration.ofMinutes(30));
    }
    
    // CSRF TokenéªŒè¯
    public boolean validateCSRFToken(HttpServletRequest request) {
        String headerToken = request.getHeader("X-CSRF-Token");
        String sessionToken = (String) request.getSession().getAttribute("CSRF_TOKEN");
        
        return headerToken != null && headerToken.equals(sessionToken);
    }
    
    // ç”Ÿæˆå®‰å…¨çš„éšæœºToken
    public String generateSecureToken(int length) {
        SecureRandom random = new SecureRandom();
        StringBuilder token = new StringBuilder();
        String chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        
        for (int i = 0; i < length; i++) {
            token.append(chars.charAt(random.nextInt(chars.length())));
        }
        
        return token.toString();
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è·¨åŸŸä¼šè¯ç®¡ç†æœ¬è´¨ï¼šè§£å†³åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„èº«ä»½è®¤è¯é—®é¢˜
ğŸ”¸ åŒæºç­–ç•¥é™åˆ¶ï¼šæµè§ˆå™¨å®‰å…¨æœºåˆ¶å¯¼è‡´çš„è·¨åŸŸCookieé™åˆ¶
ğŸ”¸ SSOæ ¸å¿ƒæ€æƒ³ï¼šä¸€æ¬¡ç™»å½•ï¼Œå¤„å¤„é€šè¡Œçš„ç”¨æˆ·ä½“éªŒ
ğŸ”¸ è®¤è¯ä¸æˆæƒåˆ†ç¦»ï¼šOAuth2ç­‰æ ‡å‡†åè®®çš„è®¾è®¡ç†å¿µ
ğŸ”¸ æœ‰çŠ¶æ€ vs æ— çŠ¶æ€ï¼šSessionä¸JWTä¸¤ç§æŠ€æœ¯è·¯çº¿å¯¹æ¯”
```

### 8.2 å…³é”®æŠ€æœ¯ç†è§£


**ğŸ”¹ Cookieè·¨åŸŸè®¾ç½®**
```
è®°å¿†è¦ç‚¹ï¼š
âœ… domainè®¾ç½®ä¸ºä¸»åŸŸå(.company.com)
âœ… pathè®¾ç½®ä¸ºæ ¹è·¯å¾„(/)
âœ… HTTPSç¯å¢ƒè®¾ç½®secure=true
âœ… é˜²XSSè®¾ç½®httpOnly=true
```

**ğŸ”¹ SSOè®¤è¯æµç¨‹**
```
æ ¸å¿ƒæ­¥éª¤ï¼š
1ï¸âƒ£ ç”¨æˆ·è®¿é—®ç³»ç»ŸAï¼Œå‘ç°æœªç™»å½•
2ï¸âƒ£ é‡å®šå‘åˆ°SSOè®¤è¯ä¸­å¿ƒ
3ï¸âƒ£ SSOéªŒè¯ç”¨æˆ·èº«ä»½ï¼Œç”Ÿæˆç¥¨æ®
4ï¸âƒ£ é‡å®šå‘å›ç³»ç»ŸAå¹¶æºå¸¦ç¥¨æ®
5ï¸âƒ£ ç³»ç»ŸAéªŒè¯ç¥¨æ®ï¼Œå»ºç«‹æœ¬åœ°Session
6ï¸âƒ£ ç”¨æˆ·è®¿é—®ç³»ç»ŸBï¼ŒSSOç›´æ¥ç­¾å‘ç¥¨æ®
```

**ğŸ”¹ JWT Tokenæœºåˆ¶**
```
ä¼˜åŠ¿ç†è§£ï¼š
ğŸ”¸ æ— çŠ¶æ€ï¼šä¸ä¾èµ–æœåŠ¡å™¨å­˜å‚¨
ğŸ”¸ è·¨åŸŸå‹å¥½ï¼šé€‚åˆåˆ†å¸ƒå¼æ¶æ„
ğŸ”¸ ç§»åŠ¨ç«¯å…¼å®¹ï¼šä¸ä¾èµ–Cookieæœºåˆ¶
ğŸ”¸ æ€§èƒ½å¥½ï¼šæœ¬åœ°éªŒè¯ï¼Œæ— ç½‘ç»œIO
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æŠ€æœ¯é€‰å‹å»ºè®®**
```
ä¼ä¸šå†…éƒ¨ç³»ç»Ÿï¼š
âœ… æ¨è CAS + LDAP
åŸå› ï¼šå®‰å…¨æ€§é«˜ï¼Œå¯æ§æ€§å¼ºï¼Œæ”¯æŒå¤æ‚æƒé™

äº’è”ç½‘åº”ç”¨ï¼š  
âœ… æ¨è OAuth2 + JWT
åŸå› ï¼šå¼€æ”¾æ€§å¥½ï¼Œç”¨æˆ·ä½“éªŒä½³ï¼Œæ‰©å±•æ€§å¼º

ç§»åŠ¨ç«¯APIï¼š
âœ… æ¨è JWT + Refresh Token  
åŸå› ï¼šæ— çŠ¶æ€è®¾è®¡ï¼Œç½‘ç»œå‹å¥½ï¼Œç¦»çº¿æ”¯æŒ

ç”µå•†å¹³å°ï¼š
âœ… æ¨è è·¨åŸŸCookie + Redis Session
åŸå› ï¼šå®‰å…¨è¦æ±‚é«˜ï¼Œéœ€è¦çŠ¶æ€ç®¡æ§
```

**ğŸ”§ å®æ–½æ­¥éª¤è§„åˆ’**
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„æ­å»º
ğŸ”¸ é€‰æ‹©è®¤è¯åè®®ï¼ˆCAS/OAuth2ï¼‰
ğŸ”¸ éƒ¨ç½²è®¤è¯æœåŠ¡å™¨
ğŸ”¸ è®¾è®¡ç”¨æˆ·å­˜å‚¨æ–¹æ¡ˆ

ç¬¬äºŒé˜¶æ®µï¼šå®¢æˆ·ç«¯é›†æˆ
ğŸ”¸ å„ç³»ç»Ÿé›†æˆè®¤è¯å®¢æˆ·ç«¯
ğŸ”¸ ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œç”¨æˆ·ç•Œé¢
ğŸ”¸ å®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½

ç¬¬ä¸‰é˜¶æ®µï¼šå®‰å…¨åŠ å›º
ğŸ”¸ HTTPSå¼ºåˆ¶ä½¿ç”¨
ğŸ”¸ å®‰å…¨å¤´è®¾ç½®
ğŸ”¸ æ”»å‡»é˜²æŠ¤æœºåˆ¶

ç¬¬å››é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–
ğŸ”¸ ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
ğŸ”¸ è´Ÿè½½å‡è¡¡é…ç½®  
ğŸ”¸ ç›‘æ§å‘Šè­¦è®¾ç½®
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**âŒ å…¸å‹é”™è¯¯åŠè§£å†³**
```
é—®é¢˜1ï¼šCookieè·¨åŸŸä¸ç”Ÿæ•ˆ
ğŸ”§ è§£å†³ï¼šæ£€æŸ¥domainè®¾ç½®ï¼Œç¡®ä¿åŒ…å«ç‚¹å·å‰ç¼€

é—®é¢˜2ï¼šJWT Tokenè¿‡æœŸå¤„ç†
ğŸ”§ è§£å†³ï¼šå®ç°Refresh Tokenæœºåˆ¶ï¼Œè‡ªåŠ¨åˆ·æ–°

é—®é¢˜3ï¼šSSOç™»å‡ºä¸å½»åº•
ğŸ”§ è§£å†³ï¼šå®ç°å…¨å±€ç™»å‡ºï¼Œæ¸…ç†æ‰€æœ‰ç³»ç»ŸSession

é—®é¢˜4ï¼šç§»åŠ¨ç«¯è®¤è¯å›°éš¾
ğŸ”§ è§£å†³ï¼šä½¿ç”¨JWTæ›¿ä»£Cookieæœºåˆ¶

é—®é¢˜5ï¼šé«˜å¹¶å‘ä¸‹æ€§èƒ½é—®é¢˜
ğŸ”§ è§£å†³ï¼šRedisé›†ç¾¤ + JWTæ— çŠ¶æ€è®¾è®¡
```

**ğŸ¯ ç›‘æ§æŒ‡æ ‡å»ºè®®**
```
ä¸šåŠ¡æŒ‡æ ‡ï¼š
ğŸ”¸ ç™»å½•æˆåŠŸç‡ï¼š>99%
ğŸ”¸ SSOè·³è½¬è€—æ—¶ï¼š<2ç§’
ğŸ”¸ TokenéªŒè¯è€—æ—¶ï¼š<100ms

æŠ€æœ¯æŒ‡æ ‡ï¼š
ğŸ”¸ è®¤è¯æœåŠ¡å™¨å¯ç”¨æ€§ï¼š>99.9%
ğŸ”¸ Redisé›†ç¾¤å“åº”æ—¶é—´ï¼š<10ms
ğŸ”¸ JWTç­¾åéªŒè¯TPSï¼š>10000
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†å£è¯€**
```
è·¨åŸŸä¼šè¯è¦ç‰¢è®°ï¼ŒCookieåŸŸåæ˜¯å…³é”®
SSOè®¤è¯ç¥¨æ®è½¬ï¼Œä¸€æ¬¡ç™»å½•å…¨ç«™é€š  
JWTæ— çŠ¶æ€æœ€çµæ´»ï¼Œç§»åŠ¨ç«¯APIé¦–é€‰å®ƒ
å®‰å…¨é˜²æŠ¤ä¸èƒ½çœï¼ŒHTTPSåŠ å¯†æ˜¯åŸºç¡€
```

**ğŸš€ å­¦ä¹ è·¯å¾„å»ºè®®**
```
æ–°æ‰‹å…¥é—¨ï¼š
1. ç†è§£åŒæºç­–ç•¥å’Œè·¨åŸŸæ¦‚å¿µ
2. å®è·µCookieè·¨åŸŸè®¾ç½®
3. æ­å»ºç®€å•SSOç³»ç»Ÿ

è¿›é˜¶æå‡ï¼š
1. æ·±å…¥OAuth2åè®®ç»†èŠ‚
2. æŒæ¡JWTæœ€ä½³å®è·µ
3. å­¦ä¹ CASä¼ä¸šçº§åº”ç”¨

é«˜çº§åº”ç”¨ï¼š
1. åˆ†å¸ƒå¼Sessionè®¾è®¡
2. å®‰å…¨æ”»é˜²å®æˆ˜
3. æ€§èƒ½è°ƒä¼˜æ–¹æ¡ˆ
```