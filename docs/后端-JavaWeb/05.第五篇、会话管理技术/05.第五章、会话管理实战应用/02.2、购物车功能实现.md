---
title: 2ã€è´­ç‰©è½¦åŠŸèƒ½å®ç°
---
## ğŸ“š ç›®å½•

1. [è´­ç‰©è½¦åŠŸèƒ½æ¦‚è¿°](#1-è´­ç‰©è½¦åŠŸèƒ½æ¦‚è¿°)
2. [è´­ç‰©è½¦æ•°æ®ç»“æ„è®¾è®¡](#2-è´­ç‰©è½¦æ•°æ®ç»“æ„è®¾è®¡)
3. [Sessionå­˜å‚¨å•†å“æœºåˆ¶](#3-Sessionå­˜å‚¨å•†å“æœºåˆ¶)
4. [å•†å“å¢åˆ æ”¹æŸ¥æ“ä½œ](#4-å•†å“å¢åˆ æ”¹æŸ¥æ“ä½œ)
5. [æ•°é‡ä¿®æ”¹é€»è¾‘å®ç°](#5-æ•°é‡ä¿®æ”¹é€»è¾‘å®ç°)
6. [æ¸…ç©ºè´­ç‰©è½¦æ“ä½œ](#6-æ¸…ç©ºè´­ç‰©è½¦æ“ä½œ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›’ è´­ç‰©è½¦åŠŸèƒ½æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è´­ç‰©è½¦åŠŸèƒ½


**ç®€å•ç†è§£**ï¼šè´­ç‰©è½¦å°±åƒè¶…å¸‚é‡Œçš„è´­ç‰©æ¨è½¦ï¼Œç”¨æˆ·å¯ä»¥æŠŠæƒ³è¦çš„å•†å“å…ˆæ”¾è¿›å»ï¼Œæœ€åä¸€èµ·ç»“ç®—ã€‚

**ç½‘ç«™ä¸­çš„è´­ç‰©è½¦**ï¼š
```
ç”¨æˆ·è¡Œä¸ºæµç¨‹ï¼š
æµè§ˆå•†å“ â†’ ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦" â†’ å•†å“ä¸´æ—¶ä¿å­˜ â†’ ç»§ç»­è´­ç‰© â†’ æœ€ç»ˆç»“ç®—

å°±åƒè¿™æ ·ï¼š
ç”¨æˆ·çœ‹ä¸­äº†ä¸€æœ¬ä¹¦ â†’ åŠ å…¥è´­ç‰©è½¦
ç”¨æˆ·åˆçœ‹ä¸­äº†ä¸€æ”¯ç¬” â†’ åŠ å…¥è´­ç‰©è½¦  
ç”¨æˆ·ä¿®æ”¹ä¹¦çš„æ•°é‡ â†’ ä»1æœ¬æ”¹ä¸º2æœ¬
ç”¨æˆ·ä¸æƒ³è¦ç¬”äº† â†’ ä»è´­ç‰©è½¦ç§»é™¤
æœ€åå»ç»“ç®—é¡µé¢ â†’ åªç»“ç®—2æœ¬ä¹¦
```

### 1.2 è´­ç‰©è½¦çš„æ ¸å¿ƒç‰¹ç‚¹


**ğŸ”¸ ä¸´æ—¶å­˜å‚¨**
- å•†å“æ”¾å…¥è´­ç‰©è½¦åï¼Œä¸æ˜¯ç«‹å³è´­ä¹°
- ç”¨æˆ·å¯ä»¥éšæ—¶ä¿®æ”¹ã€åˆ é™¤
- å°±åƒæŠŠä¸œè¥¿å…ˆæ”¾åœ¨æ¡Œå­ä¸Šï¼Œæƒ³å¥½å†å†³å®šè¦ä¸è¦

**ğŸ”¸ ä¼šè¯ç›¸å…³**
- æ¯ä¸ªç”¨æˆ·æœ‰è‡ªå·±çš„è´­ç‰©è½¦
- æ¢ä¸ªæµè§ˆå™¨æˆ–æ¸…é™¤æ•°æ®ï¼Œè´­ç‰©è½¦å°±ç©ºäº†
- å°±åƒæ¯ä¸ªäººæœ‰è‡ªå·±çš„è´­ç‰©æ¨è½¦

**ğŸ”¸ æ“ä½œçµæ´»**
- å¯ä»¥å¢åŠ å•†å“ã€åˆ é™¤å•†å“
- å¯ä»¥ä¿®æ”¹å•†å“æ•°é‡
- å¯ä»¥ä¸€æ¬¡æ€§æ¸…ç©ºæ‰€æœ‰å•†å“

### 1.3 è´­ç‰©è½¦åŠŸèƒ½çš„åº”ç”¨åœºæ™¯


```
ç”µå•†ç½‘ç«™ï¼š
- æ·˜å®ã€äº¬ä¸œçš„è´­ç‰©è½¦
- ç”¨æˆ·å¯ä»¥æ”¶è—å¤šä¸ªå•†å“ï¼Œä¸€èµ·ä¸‹å•

é¤å…ç‚¹é¤ï¼š
- ç¾å›¢å¤–å–çš„è´­ç‰©è½¦
- é€‰æ‹©å¤šä¸ªèœå“ï¼Œæœ€åä¸€èµ·ä»˜æ¬¾

åœ¨çº¿è¯¾ç¨‹ï¼š
- ç½‘æ˜“äº‘è¯¾å ‚çš„è¯¾ç¨‹è´­ç‰©è½¦
- é€‰æ‹©å¤šé—¨è¯¾ç¨‹ï¼Œä¸€èµ·è´­ä¹°äº«å—ä¼˜æƒ 
```

---

## 2. ğŸ—‚ï¸ è´­ç‰©è½¦æ•°æ®ç»“æ„è®¾è®¡


### 2.1 å•†å“ä¿¡æ¯åŒ…å«ä»€ä¹ˆ


**ä¸€ä¸ªå•†å“éœ€è¦è®°å½•çš„ä¿¡æ¯**ï¼š
```
å•†å“åŸºæœ¬ä¿¡æ¯ï¼š
- å•†å“IDï¼šå”¯ä¸€æ ‡è¯†è¿™ä¸ªå•†å“
- å•†å“åç§°ï¼šæ˜¾ç¤ºç»™ç”¨æˆ·çœ‹çš„åå­—
- å•†å“ä»·æ ¼ï¼šå•ä»·å¤šå°‘é’±
- å•†å“å›¾ç‰‡ï¼šå±•ç¤ºç”¨çš„å›¾ç‰‡åœ°å€

è´­ç‰©è½¦ç‰¹æœ‰ä¿¡æ¯ï¼š
- è´­ä¹°æ•°é‡ï¼šç”¨æˆ·è¦ä¹°å‡ ä¸ª
- æ·»åŠ æ—¶é—´ï¼šä»€ä¹ˆæ—¶å€™åŠ å…¥è´­ç‰©è½¦çš„ï¼ˆå¯é€‰ï¼‰
```

### 2.2 è´­ç‰©è½¦å•†å“ç±»çš„è®¾è®¡


```java
/**
 * è´­ç‰©è½¦ä¸­çš„å•†å“é¡¹
 * å°±åƒè´­ç‰©è½¦é‡Œçš„ä¸€ä¸ªå•†å“æ ‡ç­¾
 */
public class CartItem {
    private Integer productId;    // å•†å“ID - å•†å“çš„èº«ä»½è¯å·
    private String productName;   // å•†å“åç§° - å•†å“å«ä»€ä¹ˆ
    private Double productPrice;  // å•†å“ä»·æ ¼ - å•ä»·å¤šå°‘é’±
    private String productImage;  // å•†å“å›¾ç‰‡ - å±•ç¤ºå›¾ç‰‡çš„ç½‘å€
    private Integer quantity;     // è´­ä¹°æ•°é‡ - ç”¨æˆ·è¦ä¹°å‡ ä¸ª
    
    // æ„é€ æ–¹æ³•ï¼šåˆ›å»ºä¸€ä¸ªè´­ç‰©è½¦å•†å“é¡¹
    public CartItem(Integer productId, String productName, 
                   Double productPrice, String productImage, Integer quantity) {
        this.productId = productId;
        this.productName = productName;
        this.productPrice = productPrice;
        this.productImage = productImage;
        this.quantity = quantity;
    }
    
    // è®¡ç®—è¿™ä¸ªå•†å“é¡¹çš„æ€»ä»·ï¼šå•ä»· Ã— æ•°é‡
    public Double getTotalPrice() {
        return productPrice * quantity;
    }
    
    // getterå’Œsetteræ–¹æ³•...
}
```

### 2.3 è´­ç‰©è½¦æ•´ä½“ç»“æ„


**è´­ç‰©è½¦çš„å­˜å‚¨æ–¹å¼**ï¼š
```
æ–¹å¼1ï¼šä½¿ç”¨Listå­˜å‚¨
ä¼˜ç‚¹ï¼šæ“ä½œç®€å•ï¼Œé€‚åˆåˆå­¦è€…
ç¼ºç‚¹ï¼šæŸ¥æ‰¾å•†å“éœ€è¦éå†

æ–¹å¼2ï¼šä½¿ç”¨Mapå­˜å‚¨ï¼ˆæ¨èï¼‰
ä¼˜ç‚¹ï¼šé€šè¿‡å•†å“IDå¿«é€Ÿæ‰¾åˆ°å•†å“
ç¼ºç‚¹ï¼šç¨å¾®å¤æ‚ä¸€ç‚¹

æˆ‘ä»¬é€‰æ‹©Mapæ–¹å¼ï¼š
Map<Integer, CartItem> cart = new HashMap<>();
keyï¼šå•†å“ID
valueï¼šè´­ç‰©è½¦å•†å“é¡¹
```

### 2.4 æ•°æ®ç»“æ„å›¾ç¤º


```
è´­ç‰©è½¦ç»“æ„ç¤ºæ„å›¾ï¼š

Sessionä¸­çš„è´­ç‰©è½¦
â”œâ”€â”€ å•†å“ID: 1001
â”‚   â””â”€â”€ CartItem {
â”‚       â”œâ”€â”€ productId: 1001
â”‚       â”œâ”€â”€ productName: "iPhone 15"
â”‚       â”œâ”€â”€ productPrice: 5999.0
â”‚       â”œâ”€â”€ productImage: "/images/iphone15.jpg"
â”‚       â””â”€â”€ quantity: 1
â”‚   }
â”œâ”€â”€ å•†å“ID: 2001  
â”‚   â””â”€â”€ CartItem {
â”‚       â”œâ”€â”€ productId: 2001
â”‚       â”œâ”€â”€ productName: "åä¸ºæ‰‹æœºå£³"
â”‚       â”œâ”€â”€ productPrice: 39.9
â”‚       â”œâ”€â”€ productImage: "/images/case.jpg"
â”‚       â””â”€â”€ quantity: 2
â”‚   }
â””â”€â”€ ...æ›´å¤šå•†å“
```

---

## 3. ğŸ“¦ Sessionå­˜å‚¨å•†å“æœºåˆ¶


### 3.1 ä¸ºä»€ä¹ˆç”¨Sessionå­˜å‚¨è´­ç‰©è½¦


**Sessionçš„ç‰¹ç‚¹**ï¼š
```
ä¼šè¯éš”ç¦»ï¼š
- æ¯ä¸ªç”¨æˆ·çš„Sessionæ˜¯ç‹¬ç«‹çš„
- ç”¨æˆ·Açš„è´­ç‰©è½¦ä¸ä¼šå½±å“ç”¨æˆ·B
- å°±åƒæ¯ä¸ªäººæœ‰è‡ªå·±çš„å‚¨ç‰©æŸœ

ä¸´æ—¶å­˜å‚¨ï¼š
- Sessionåœ¨ç”¨æˆ·å…³é—­æµè§ˆå™¨åä¼šå¤±æ•ˆ
- é€‚åˆè´­ç‰©è½¦è¿™ç§ä¸´æ—¶æ•°æ®
- ä¸ä¼šæ°¸ä¹…å ç”¨æœåŠ¡å™¨ç©ºé—´

æœåŠ¡å™¨ç«¯å­˜å‚¨ï¼š
- æ•°æ®å­˜åœ¨æœåŠ¡å™¨å†…å­˜ä¸­
- æ¯”Cookieæ›´å®‰å…¨ï¼Œå®¹é‡æ›´å¤§
- ç”¨æˆ·æ— æ³•ç›´æ¥ä¿®æ”¹è´­ç‰©è½¦æ•°æ®
```

### 3.2 Sessionä¸­è´­ç‰©è½¦çš„å­˜å‚¨æ–¹å¼


```java
/**
 * è´­ç‰©è½¦å·¥å…·ç±»
 * ä¸“é—¨å¤„ç†è´­ç‰©è½¦ç›¸å…³æ“ä½œ
 */
public class CartUtil {
    
    // è´­ç‰©è½¦åœ¨Sessionä¸­çš„å±æ€§å
    private static final String CART_KEY = "shoppingCart";
    
    /**
     * ä»Sessionä¸­è·å–è´­ç‰©è½¦
     * å¦‚æœæ²¡æœ‰è´­ç‰©è½¦ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„
     */
    public static Map<Integer, CartItem> getCart(HttpSession session) {
        // å°è¯•ä»Sessionä¸­è·å–è´­ç‰©è½¦
        Map<Integer, CartItem> cart = 
            (Map<Integer, CartItem>) session.getAttribute(CART_KEY);
        
        // å¦‚æœè´­ç‰©è½¦ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºè´­ç‰©è½¦
        if (cart == null) {
            cart = new HashMap<>();
            session.setAttribute(CART_KEY, cart);
        }
        
        return cart;
    }
}
```

### 3.3 Sessionå­˜å‚¨çš„å·¥ä½œæµç¨‹


```
ç”¨æˆ·è®¿é—®ç½‘ç«™çš„æµç¨‹ï¼š

1. ç”¨æˆ·é¦–æ¬¡è®¿é—®
   â”œâ”€â”€ æœåŠ¡å™¨åˆ›å»ºæ–°çš„Session
   â”œâ”€â”€ åˆ†é…SessionID
   â””â”€â”€ è´­ç‰©è½¦ä¸ºç©º

2. ç”¨æˆ·æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
   â”œâ”€â”€ ä»Sessionè·å–è´­ç‰©è½¦Map
   â”œâ”€â”€ å¦‚æœè´­ç‰©è½¦ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„
   â”œâ”€â”€ å°†å•†å“æ·»åŠ åˆ°Mapä¸­
   â””â”€â”€ Mapè‡ªåŠ¨ä¿å­˜åˆ°Session

3. ç”¨æˆ·ç»§ç»­è´­ç‰©
   â”œâ”€â”€ è´­ç‰©è½¦æ•°æ®ä¸€ç›´åœ¨Sessionä¸­
   â”œâ”€â”€ å¯ä»¥éšæ—¶å¢åˆ æ”¹æŸ¥
   â””â”€â”€ æ•°æ®è·Ÿéšç”¨æˆ·ä¼šè¯

4. ç”¨æˆ·å…³é—­æµè§ˆå™¨
   â”œâ”€â”€ Sessionè¿‡æœŸ
   â”œâ”€â”€ è´­ç‰©è½¦æ•°æ®è¢«æ¸…é™¤
   â””â”€â”€ ä¸‹æ¬¡è®¿é—®éœ€è¦é‡æ–°æ·»åŠ 
```

### 3.4 Sessionè´­ç‰©è½¦çš„ä¼˜åŠ¿å’Œå±€é™


| **ç‰¹æ€§** | **ä¼˜åŠ¿** | **å±€é™** |
|---------|---------|---------|
| **å®‰å…¨æ€§** | `æœåŠ¡å™¨ç«¯å­˜å‚¨ï¼Œç”¨æˆ·æ— æ³•ç¯¡æ”¹` | `ç›¸å¯¹å®‰å…¨ä½†ä¸æ˜¯ç»å¯¹å®‰å…¨` |
| **å®¹é‡** | `æ¯”Cookieå¤§å¾—å¤šï¼Œå¯å­˜å‚¨å¤æ‚å¯¹è±¡` | `å ç”¨æœåŠ¡å™¨å†…å­˜` |
| **æŒä¹…æ€§** | `åœ¨ä¼šè¯æœŸé—´æ•°æ®ç¨³å®š` | `å…³é—­æµè§ˆå™¨åæ•°æ®ä¸¢å¤±` |
| **éš”ç¦»æ€§** | `æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„è´­ç‰©è½¦` | `æ— æ³•è·¨è®¾å¤‡å…±äº«` |

---

## 4. ğŸ”§ å•†å“å¢åˆ æ”¹æŸ¥æ“ä½œ


### 4.1 æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦


**æ·»åŠ å•†å“çš„ä¸šåŠ¡é€»è¾‘**ï¼š
```
ç”¨æˆ·ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®æ—¶ï¼š
1. æ£€æŸ¥å•†å“æ˜¯å¦å·²åœ¨è´­ç‰©è½¦ä¸­
2. å¦‚æœå·²å­˜åœ¨ï¼šæ•°é‡+1
3. å¦‚æœä¸å­˜åœ¨ï¼šåˆ›å»ºæ–°çš„è´­ç‰©è½¦é¡¹
4. æ›´æ–°è´­ç‰©è½¦åˆ°Session
```

```java
/**
 * æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦çš„Servlet
 */
@WebServlet("/cart/add")
public class AddToCartServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // è·å–ç”¨æˆ·æäº¤çš„å•†å“ä¿¡æ¯
        String productIdStr = request.getParameter("productId");
        String productName = request.getParameter("productName");
        String productPriceStr = request.getParameter("productPrice");
        String productImage = request.getParameter("productImage");
        String quantityStr = request.getParameter("quantity");
        
        // å‚æ•°éªŒè¯å’Œè½¬æ¢
        if (productIdStr == null || productName == null || productPriceStr == null) {
            response.sendRedirect("error.jsp");
            return;
        }
        
        try {
            Integer productId = Integer.parseInt(productIdStr);
            Double productPrice = Double.parseDouble(productPriceStr);
            Integer quantity = quantityStr != null ? Integer.parseInt(quantityStr) : 1;
            
            // è·å–è´­ç‰©è½¦
            HttpSession session = request.getSession();
            Map<Integer, CartItem> cart = CartUtil.getCart(session);
            
            // æ£€æŸ¥å•†å“æ˜¯å¦å·²åœ¨è´­ç‰©è½¦ä¸­
            if (cart.containsKey(productId)) {
                // å•†å“å·²å­˜åœ¨ï¼Œå¢åŠ æ•°é‡
                CartItem existingItem = cart.get(productId);
                existingItem.setQuantity(existingItem.getQuantity() + quantity);
            } else {
                // å•†å“ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„è´­ç‰©è½¦é¡¹
                CartItem newItem = new CartItem(productId, productName, 
                                              productPrice, productImage, quantity);
                cart.put(productId, newItem);
            }
            
            // è¿”å›è´­ç‰©è½¦é¡µé¢
            response.sendRedirect("cart.jsp");
            
        } catch (NumberFormatException e) {
            response.sendRedirect("error.jsp");
        }
    }
}
```

### 4.2 æŸ¥çœ‹è´­ç‰©è½¦å•†å“


**æŸ¥çœ‹è´­ç‰©è½¦çš„JSPé¡µé¢**ï¼š
```jsp
<%-- cart.jsp - è´­ç‰©è½¦é¡µé¢ --%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<!DOCTYPE html>
<html>
<head>
    <title>æˆ‘çš„è´­ç‰©è½¦</title>
</head>
<body>
    <h2>æˆ‘çš„è´­ç‰©è½¦</h2>
    
    <%-- è·å–è´­ç‰©è½¦æ•°æ® --%>
    <c:set var="cart" value="${sessionScope.shoppingCart}" />
    
    <c:choose>
        <c:when test="${empty cart}">
            <p>è´­ç‰©è½¦æ˜¯ç©ºçš„ï¼Œå»<a href="products.jsp">é€‰è´­å•†å“</a>å§ï¼</p>
        </c:when>
        <c:otherwise>
            <table border="1">
                <tr>
                    <th>å•†å“å›¾ç‰‡</th>
                    <th>å•†å“åç§°</th>
                    <th>å•ä»·</th>
                    <th>æ•°é‡</th>
                    <th>å°è®¡</th>
                    <th>æ“ä½œ</th>
                </tr>
                
                <c:forEach var="item" items="${cart}">
                    <tr>
                        <td><img src="${item.value.productImage}" width="50"></td>
                        <td>${item.value.productName}</td>
                        <td>Â¥${item.value.productPrice}</td>
                        <td>${item.value.quantity}</td>
                        <td>Â¥${item.value.totalPrice}</td>
                        <td>
                            <a href="cart/remove?productId=${item.key}">åˆ é™¤</a>
                        </td>
                    </tr>
                </c:forEach>
            </table>
        </c:otherwise>
    </c:choose>
</body>
</html>
```

### 4.3 åˆ é™¤è´­ç‰©è½¦ä¸­çš„å•†å“


```java
/**
 * ä»è´­ç‰©è½¦åˆ é™¤å•†å“çš„Servlet
 */
@WebServlet("/cart/remove")
public class RemoveFromCartServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        String productIdStr = request.getParameter("productId");
        
        if (productIdStr != null) {
            try {
                Integer productId = Integer.parseInt(productIdStr);
                
                // è·å–è´­ç‰©è½¦å¹¶åˆ é™¤æŒ‡å®šå•†å“
                HttpSession session = request.getSession();
                Map<Integer, CartItem> cart = CartUtil.getCart(session);
                cart.remove(productId);
                
                // è¿”å›è´­ç‰©è½¦é¡µé¢
                response.sendRedirect("../cart.jsp");
                
            } catch (NumberFormatException e) {
                response.sendRedirect("../error.jsp");
            }
        } else {
            response.sendRedirect("../cart.jsp");
        }
    }
}
```

### 4.4 å•†å“æ“ä½œæµç¨‹å›¾


```
å•†å“è´­ç‰©è½¦æ“ä½œæµç¨‹ï¼š

æ·»åŠ å•†å“æµç¨‹ï¼š
ç”¨æˆ· â†’ å•†å“é¡µé¢ â†’ ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦" â†’ AddToCartServlet
  â†“
æ£€æŸ¥å•†å“æ˜¯å¦å­˜åœ¨ â†’ å­˜åœ¨ï¼šæ•°é‡+1 â†’ æ›´æ–°è´­ç‰©è½¦
  â†“                â†“
ä¸å­˜åœ¨ï¼šåˆ›å»ºæ–°é¡¹ â†’ æ·»åŠ åˆ°è´­ç‰©è½¦ â†’ è·³è½¬åˆ°è´­ç‰©è½¦é¡µé¢

åˆ é™¤å•†å“æµç¨‹ï¼š
ç”¨æˆ· â†’ è´­ç‰©è½¦é¡µé¢ â†’ ç‚¹å‡»"åˆ é™¤" â†’ RemoveFromCartServlet
  â†“
ä»Mapä¸­ç§»é™¤å•†å“ â†’ è·³è½¬å›è´­ç‰©è½¦é¡µé¢

æŸ¥çœ‹è´­ç‰©è½¦æµç¨‹ï¼š
ç”¨æˆ· â†’ è®¿é—®cart.jsp â†’ ä»Sessionè·å–è´­ç‰©è½¦ â†’ æ˜¾ç¤ºå•†å“åˆ—è¡¨
```

---

## 5. âš™ï¸ æ•°é‡ä¿®æ”¹é€»è¾‘å®ç°


### 5.1 æ•°é‡ä¿®æ”¹çš„éœ€æ±‚åˆ†æ


**ç”¨æˆ·å¯¹æ•°é‡ä¿®æ”¹çš„éœ€æ±‚**ï¼š
```
åœºæ™¯1ï¼šç”¨æˆ·æƒ³ä¹°æ›´å¤š
- åŸæ¥ä¹°1ä¸ªiPhoneï¼Œç°åœ¨æƒ³ä¹°2ä¸ª
- åœ¨è´­ç‰©è½¦é¡µé¢ç›´æ¥ä¿®æ”¹æ•°é‡

åœºæ™¯2ï¼šç”¨æˆ·æƒ³ä¹°å°‘ä¸€ç‚¹
- åŸæ¥ä¹°5æœ¬ä¹¦ï¼Œç°åœ¨åªæƒ³ä¹°2æœ¬
- ç›´æ¥åœ¨æ•°é‡æ¡†é‡Œæ”¹æ•°å­—

åœºæ™¯3ï¼šæ•°é‡æ”¹ä¸º0
- ç­‰åŒäºåˆ é™¤è¿™ä¸ªå•†å“
- éœ€è¦ç‰¹æ®Šå¤„ç†
```

### 5.2 æ•°é‡ä¿®æ”¹çš„ç•Œé¢è®¾è®¡


**è´­ç‰©è½¦é¡µé¢ä¸­çš„æ•°é‡ä¿®æ”¹**ï¼š
```jsp
<%-- åœ¨cart.jspä¸­æ·»åŠ æ•°é‡ä¿®æ”¹åŠŸèƒ½ --%>
<c:forEach var="item" items="${cart}">
    <tr>
        <td><img src="${item.value.productImage}" width="50"></td>
        <td>${item.value.productName}</td>
        <td>Â¥${item.value.productPrice}</td>
        <td>
            <%-- æ•°é‡ä¿®æ”¹è¡¨å• --%>
            <form action="cart/updateQuantity" method="post" style="display:inline;">
                <input type="hidden" name="productId" value="${item.key}">
                <input type="number" name="quantity" value="${item.value.quantity}" 
                       min="0" max="99" style="width:50px;">
                <input type="submit" value="æ›´æ–°">
            </form>
        </td>
        <td>Â¥${item.value.totalPrice}</td>
        <td>
            <a href="cart/remove?productId=${item.key}">åˆ é™¤</a>
        </td>
    </tr>
</c:forEach>
```

### 5.3 æ•°é‡ä¿®æ”¹çš„åå°å¤„ç†


```java
/**
 * æ›´æ–°è´­ç‰©è½¦å•†å“æ•°é‡çš„Servlet
 */
@WebServlet("/cart/updateQuantity")
public class UpdateQuantityServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        String productIdStr = request.getParameter("productId");
        String quantityStr = request.getParameter("quantity");
        
        if (productIdStr != null && quantityStr != null) {
            try {
                Integer productId = Integer.parseInt(productIdStr);
                Integer newQuantity = Integer.parseInt(quantityStr);
                
                HttpSession session = request.getSession();
                Map<Integer, CartItem> cart = CartUtil.getCart(session);
                
                // å¤„ç†ä¸åŒçš„æ•°é‡æƒ…å†µ
                if (newQuantity <= 0) {
                    // æ•°é‡ä¸º0æˆ–è´Ÿæ•°ï¼Œåˆ é™¤å•†å“
                    cart.remove(productId);
                } else if (newQuantity > 99) {
                    // æ•°é‡è¶…è¿‡é™åˆ¶ï¼Œè®¾ä¸ºæœ€å¤§å€¼
                    CartItem item = cart.get(productId);
                    if (item != null) {
                        item.setQuantity(99);
                    }
                } else {
                    // æ­£å¸¸æ›´æ–°æ•°é‡
                    CartItem item = cart.get(productId);
                    if (item != null) {
                        item.setQuantity(newQuantity);
                    }
                }
                
                response.sendRedirect("../cart.jsp");
                
            } catch (NumberFormatException e) {
                response.sendRedirect("../error.jsp");
            }
        } else {
            response.sendRedirect("../cart.jsp");
        }
    }
}
```

### 5.4 æ•°é‡ä¿®æ”¹çš„ä¸šåŠ¡è§„åˆ™


**æ•°é‡ä¿®æ”¹çš„çº¦æŸæ¡ä»¶**ï¼š
```java
/**
 * è´­ç‰©è½¦æ•°é‡éªŒè¯å·¥å…·
 */
public class QuantityValidator {
    
    public static final int MIN_QUANTITY = 1;
    public static final int MAX_QUANTITY = 99;
    
    /**
     * éªŒè¯å¹¶è°ƒæ•´æ•°é‡
     * @param quantity ç”¨æˆ·è¾“å…¥çš„æ•°é‡
     * @return è°ƒæ•´åçš„æœ‰æ•ˆæ•°é‡ï¼Œå¦‚æœæ— æ•ˆè¿”å›nullè¡¨ç¤ºåˆ é™¤
     */
    public static Integer validateQuantity(Integer quantity) {
        if (quantity == null || quantity <= 0) {
            return null; // åˆ é™¤å•†å“
        }
        
        if (quantity > MAX_QUANTITY) {
            return MAX_QUANTITY; // é™åˆ¶æœ€å¤§æ•°é‡
        }
        
        return quantity; // æ•°é‡æœ‰æ•ˆ
    }
}
```

### 5.5 æ•°é‡ä¿®æ”¹çš„ç”¨æˆ·ä½“éªŒä¼˜åŒ–


**Ajaxæ–¹å¼çš„æ•°é‡æ›´æ–°**ï¼š
```jsp
<script>
// ä½¿ç”¨Ajaxæ›´æ–°æ•°é‡ï¼Œé¿å…é¡µé¢åˆ·æ–°
function updateQuantity(productId, newQuantity) {
    // åŸºæœ¬éªŒè¯
    if (newQuantity < 0 || newQuantity > 99) {
        alert('æ•°é‡å¿…é¡»åœ¨1-99ä¹‹é—´');
        return;
    }
    
    // å‘é€Ajaxè¯·æ±‚
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'cart/updateQuantity', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            // æ›´æ–°æˆåŠŸï¼Œåˆ·æ–°è´­ç‰©è½¦æ˜¾ç¤º
            location.reload();
        }
    };
    
    xhr.send('productId=' + productId + '&quantity=' + newQuantity);
}
</script>
```

---

## 6. ğŸ—‘ï¸ æ¸…ç©ºè´­ç‰©è½¦æ“ä½œ


### 6.1 æ¸…ç©ºè´­ç‰©è½¦çš„åº”ç”¨åœºæ™¯


**ä»€ä¹ˆæ—¶å€™éœ€è¦æ¸…ç©ºè´­ç‰©è½¦**ï¼š
```
ç”¨æˆ·ä¸»åŠ¨æ¸…ç©ºï¼š
- ç”¨æˆ·ä¸æƒ³è¦è´­ç‰©è½¦é‡Œçš„æ‰€æœ‰å•†å“
- æƒ³é‡æ–°å¼€å§‹é€‰è´­
- ä¸€é”®æ¸…ç©ºæ¯”ä¸€ä¸ªä¸ªåˆ é™¤æ–¹ä¾¿

ç³»ç»Ÿè‡ªåŠ¨æ¸…ç©ºï¼š
- ç”¨æˆ·æˆåŠŸä¸‹å•åï¼Œæ¸…ç©ºè´­ç‰©è½¦
- ç”¨æˆ·ç™»å½•æ—¶ï¼Œå¯èƒ½éœ€è¦åˆå¹¶æˆ–æ¸…ç©ºæ¸¸å®¢è´­ç‰©è½¦
- Sessionè¿‡æœŸæ—¶ï¼Œè´­ç‰©è½¦è‡ªåŠ¨æ¶ˆå¤±
```

### 6.2 æ¸…ç©ºè´­ç‰©è½¦çš„å®ç°æ–¹å¼


**æ–¹å¼1ï¼šç›´æ¥æ¸…ç©ºMap**
```java
/**
 * æ¸…ç©ºè´­ç‰©è½¦çš„Servlet
 */
@WebServlet("/cart/clear")
public class ClearCartServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        HttpSession session = request.getSession();
        Map<Integer, CartItem> cart = CartUtil.getCart(session);
        
        // æ¸…ç©ºè´­ç‰©è½¦çš„æ‰€æœ‰å•†å“
        cart.clear();
        
        // è·³è½¬å›è´­ç‰©è½¦é¡µé¢
        response.sendRedirect("../cart.jsp");
    }
}
```

**æ–¹å¼2ï¼šç§»é™¤Sessionå±æ€§**
```java
/**
 * å¦ä¸€ç§æ¸…ç©ºè´­ç‰©è½¦çš„æ–¹å¼
 */
public static void clearCart(HttpSession session) {
    // ç›´æ¥ä»Sessionä¸­ç§»é™¤è´­ç‰©è½¦å±æ€§
    session.removeAttribute("shoppingCart");
}
```

### 6.3 æ¸…ç©ºè´­ç‰©è½¦çš„ç”¨æˆ·ç¡®è®¤


**æ·»åŠ ç¡®è®¤å¯¹è¯æ¡†**ï¼š
```jsp
<%-- åœ¨cart.jspä¸­æ·»åŠ æ¸…ç©ºè´­ç‰©è½¦æŒ‰é’® --%>
<div style="text-align: right; margin: 10px 0;">
    <button onclick="confirmClearCart()" style="background-color: #ff4d4f; color: white; padding: 8px 16px;">
        æ¸…ç©ºè´­ç‰©è½¦
    </button>
</div>

<script>
function confirmClearCart() {
    // ç¡®è®¤å¯¹è¯æ¡†
    if (confirm('ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿè¿™ä¸ªæ“ä½œä¸å¯æ¢å¤ï¼')) {
        // ç”¨æˆ·ç¡®è®¤ï¼Œæäº¤æ¸…ç©ºè¯·æ±‚
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = 'cart/clear';
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
```

### 6.4 æ¸…ç©ºè´­ç‰©è½¦çš„å®Œæ•´æµç¨‹


```
æ¸…ç©ºè´­ç‰©è½¦çš„å®Œæ•´æµç¨‹ï¼š

ç”¨æˆ·æ“ä½œæµç¨‹ï¼š
1. ç”¨æˆ·åœ¨è´­ç‰©è½¦é¡µé¢ç‚¹å‡»"æ¸…ç©ºè´­ç‰©è½¦"æŒ‰é’®
   â†“
2. æµè§ˆå™¨å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ï¼š"ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿ"
   â†“
3. ç”¨æˆ·é€‰æ‹©ï¼š
   â”œâ”€â”€ ç‚¹å‡»"ç¡®å®š" â†’ ç»§ç»­æµç¨‹
   â””â”€â”€ ç‚¹å‡»"å–æ¶ˆ" â†’ è¿”å›è´­ç‰©è½¦é¡µé¢
   â†“
4. æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€POSTè¯·æ±‚åˆ° /cart/clear
   â†“
5. ClearCartServletå¤„ç†è¯·æ±‚ï¼š
   â”œâ”€â”€ è·å–Sessionä¸­çš„è´­ç‰©è½¦
   â”œâ”€â”€ è°ƒç”¨cart.clear()æ–¹æ³•æ¸…ç©º
   â””â”€â”€ è·³è½¬å›è´­ç‰©è½¦é¡µé¢
   â†“
6. ç”¨æˆ·çœ‹åˆ°ç©ºçš„è´­ç‰©è½¦é¡µé¢ï¼Œæ˜¾ç¤º"è´­ç‰©è½¦æ˜¯ç©ºçš„"

ä¸‹å•æˆåŠŸåè‡ªåŠ¨æ¸…ç©ºï¼š
è®¢å•æäº¤æˆåŠŸ â†’ OrderServlet â†’ æ¸…ç©ºè´­ç‰©è½¦ â†’ è·³è½¬åˆ°è®¢å•ç¡®è®¤é¡µé¢
```

### 6.5 æ¸…ç©ºæ“ä½œçš„å®‰å…¨è€ƒè™‘


**é˜²æ­¢è¯¯æ“ä½œçš„æªæ–½**ï¼š
```java
/**
 * å¢å¼ºç‰ˆæ¸…ç©ºè´­ç‰©è½¦ï¼Œæ·»åŠ é¢å¤–éªŒè¯
 */
@WebServlet("/cart/clear")
public class ClearCartServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // æ£€æŸ¥æ˜¯å¦æœ‰ç¡®è®¤å‚æ•°
        String confirm = request.getParameter("confirm");
        if (!"true".equals(confirm)) {
            response.sendRedirect("../cart.jsp");
            return;
        }
        
        HttpSession session = request.getSession();
        Map<Integer, CartItem> cart = CartUtil.getCart(session);
        
        // è®°å½•æ¸…ç©ºå‰çš„å•†å“æ•°é‡ï¼ˆç”¨äºæ—¥å¿—ï¼‰
        int itemCount = cart.size();
        
        // æ¸…ç©ºè´­ç‰©è½¦
        cart.clear();
        
        // å¯ä»¥åœ¨è¿™é‡Œè®°å½•æ—¥å¿—
        System.out.println("ç”¨æˆ·æ¸…ç©ºäº†åŒ…å« " + itemCount + " ä¸ªå•†å“çš„è´­ç‰©è½¦");
        
        // è®¾ç½®æˆåŠŸæ¶ˆæ¯
        session.setAttribute("message", "è´­ç‰©è½¦å·²æ¸…ç©º");
        
        response.sendRedirect("../cart.jsp");
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è´­ç‰©è½¦æœ¬è´¨ï¼šä¸´æ—¶å­˜å‚¨ç”¨æˆ·é€‰æ‹©å•†å“çš„å®¹å™¨
ğŸ”¸ Sessionå­˜å‚¨ï¼šåˆ©ç”¨Sessionçš„ä¼šè¯éš”ç¦»ç‰¹æ€§å­˜å‚¨è´­ç‰©è½¦
ğŸ”¸ æ•°æ®ç»“æ„ï¼šMap<Integer, CartItem>ï¼Œé€šè¿‡å•†å“IDå¿«é€Ÿå®šä½
ğŸ”¸ æ ¸å¿ƒæ“ä½œï¼šå¢åˆ æ”¹æŸ¥ + æ¸…ç©ºï¼Œæ»¡è¶³ç”¨æˆ·çš„åŸºæœ¬éœ€æ±‚
ğŸ”¸ ä¸šåŠ¡é€»è¾‘ï¼šæ•°é‡éªŒè¯ã€é‡å¤å•†å“å¤„ç†ã€ç”¨æˆ·ä½“éªŒä¼˜åŒ–
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆé€‰æ‹©Sessionå­˜å‚¨è´­ç‰©è½¦**
```
ä¼šè¯éš”ç¦»ï¼šæ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„è´­ç‰©è½¦
ä¸´æ—¶æ€§ï¼šé€‚åˆè´­ç‰©è½¦çš„ä¸´æ—¶ç‰¹æ€§
å®‰å…¨æ€§ï¼šæœåŠ¡å™¨ç«¯å­˜å‚¨ï¼Œç”¨æˆ·æ— æ³•ç¯¡æ”¹
å®¹é‡ï¼šæ¯”Cookieå®¹é‡å¤§ï¼Œå¯å­˜å‚¨å¤æ‚å¯¹è±¡
```

**ğŸ”¹ è´­ç‰©è½¦çš„æ•°æ®æµè½¬**
```
ç”¨æˆ·æ“ä½œ â†’ å‰ç«¯è¡¨å• â†’ Servletå¤„ç† â†’ Sessionæ›´æ–° â†’ é¡µé¢æ˜¾ç¤º

å…³é”®ç‚¹ï¼š
- æ•°æ®å§‹ç»ˆåœ¨Sessionä¸­æµè½¬
- æ¯æ¬¡æ“ä½œéƒ½è¦è·å–Sessionä¸­çš„è´­ç‰©è½¦
- ä¿®æ”¹åçš„æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°Session
```

**ğŸ”¹ å•†å“æ“ä½œçš„ä¸šåŠ¡é€»è¾‘**
```
æ·»åŠ å•†å“ï¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ â†’ å­˜åœ¨åˆ™å¢é‡ï¼Œä¸å­˜åœ¨åˆ™æ–°å»º
ä¿®æ”¹æ•°é‡ï¼šéªŒè¯èŒƒå›´ â†’ 0åˆ™åˆ é™¤ï¼Œè¶…é™åˆ™è°ƒæ•´
åˆ é™¤å•†å“ï¼šç›´æ¥ä»Mapä¸­ç§»é™¤
æ¸…ç©ºè´­ç‰©è½¦ï¼šæ¸…ç©ºæ•´ä¸ªMap
```

### 7.3 å®é™…å¼€å‘æ³¨æ„äº‹é¡¹


**ğŸ”§ ä»£ç å®ç°è¦ç‚¹**
```java
// 1. æ€»æ˜¯å…ˆæ£€æŸ¥Sessionä¸­æ˜¯å¦æœ‰è´­ç‰©è½¦
Map<Integer, CartItem> cart = CartUtil.getCart(session);

// 2. å‚æ•°éªŒè¯ä¸å¯çœç•¥
if (productIdStr == null || productIdStr.trim().isEmpty()) {
    // å¤„ç†é”™è¯¯æƒ…å†µ
}

// 3. æ•°é‡æ“ä½œè¦è€ƒè™‘è¾¹ç•Œæƒ…å†µ
if (quantity <= 0) {
    cart.remove(productId); // åˆ é™¤å•†å“
} else if (quantity > 99) {
    quantity = 99; // é™åˆ¶æœ€å¤§å€¼
}

// 4. ç”¨æˆ·æ“ä½œè¦æœ‰åé¦ˆ
session.setAttribute("message", "å•†å“å·²æ·»åŠ åˆ°è´­ç‰©è½¦");
```

**ğŸ’¡ ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
- æ·»åŠ å•†å“åç»™ç”¨æˆ·æ˜ç¡®åé¦ˆ
- æ•°é‡ä¿®æ”¹è¦æœ‰åˆç†çš„é™åˆ¶å’ŒéªŒè¯
- é‡è¦æ“ä½œï¼ˆå¦‚æ¸…ç©ºï¼‰è¦æœ‰ç¡®è®¤æç¤º
- é¡µé¢è·³è½¬è¦ç¬¦åˆç”¨æˆ·é¢„æœŸ

**âš ï¸ å¸¸è§é—®é¢˜åŠè§£å†³**
```
é—®é¢˜1ï¼šé‡å¤æ·»åŠ ç›¸åŒå•†å“
è§£å†³ï¼šæ£€æŸ¥Mapä¸­æ˜¯å¦å·²å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ç´¯åŠ æ•°é‡

é—®é¢˜2ï¼šæ•°é‡ä¿®æ”¹å¼‚å¸¸
è§£å†³ï¼šæ·»åŠ æ•°å€¼èŒƒå›´éªŒè¯å’Œå¼‚å¸¸å¤„ç†

é—®é¢˜3ï¼šSessionä¸¢å¤±å¯¼è‡´è´­ç‰©è½¦æ¸…ç©º
è§£å†³ï¼šè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå¯è€ƒè™‘æ•°æ®åº“æŒä¹…åŒ–

é—®é¢˜4ï¼šå¤šçº¿ç¨‹è®¿é—®è´­ç‰©è½¦
è§£å†³ï¼šSessionæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ— éœ€é¢å¤–å¤„ç†
```

### 7.4 æ‰©å±•åŠŸèƒ½æ€è€ƒ


**ğŸš€ è´­ç‰©è½¦åŠŸèƒ½çš„è¿›é˜¶æ‰©å±•**
- **æ•°æ®åº“æŒä¹…åŒ–**ï¼šå°†è´­ç‰©è½¦ä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ”¯æŒè·¨è®¾å¤‡è®¿é—®
- **ç”¨æˆ·ç™»å½•é›†æˆ**ï¼šæ¸¸å®¢è´­ç‰©è½¦ä¸ç™»å½•ç”¨æˆ·è´­ç‰©è½¦çš„åˆå¹¶
- **å•†å“åº“å­˜æ£€æŸ¥**ï¼šæ·»åŠ å•†å“æ—¶æ£€æŸ¥åº“å­˜ï¼Œé¿å…è¶…å–
- **ä»·æ ¼å®æ—¶æ›´æ–°**ï¼šå•†å“ä»·æ ¼å˜åŠ¨æ—¶æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º
- **è´­ç‰©è½¦è¿‡æœŸæœºåˆ¶**ï¼šè®¾ç½®è´­ç‰©è½¦å•†å“çš„è¿‡æœŸæ—¶é—´

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è´­ç‰©è½¦Sessionå­˜ï¼ŒMapç»“æ„å•†å“åˆ†
- å¢åˆ æ”¹æŸ¥åŠ æ¸…ç©ºï¼Œæ•°é‡éªŒè¯ä¸èƒ½å¿˜
- ç”¨æˆ·ä½“éªŒè¦å‹å¥½ï¼Œç¡®è®¤æç¤ºé˜²è¯¯æ“ä½œ