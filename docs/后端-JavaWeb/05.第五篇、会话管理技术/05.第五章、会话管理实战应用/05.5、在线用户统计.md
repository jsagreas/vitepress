---
title: 5ã€åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡
---
## ğŸ“š ç›®å½•

1. [åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡æ¦‚è¿°](#1-åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡æ¦‚è¿°)
2. [HttpSessionListenerç›‘å¬å™¨](#2-HttpSessionListenerç›‘å¬å™¨)
3. [Sessionç”Ÿå‘½å‘¨æœŸç›‘å¬](#3-Sessionç”Ÿå‘½å‘¨æœŸç›‘å¬)
4. [åœ¨çº¿ç”¨æˆ·è®¡æ•°å®ç°](#4-åœ¨çº¿ç”¨æˆ·è®¡æ•°å®ç°)
5. [å®æ—¶ç»Ÿè®¡æ˜¾ç¤º](#5-å®æ—¶ç»Ÿè®¡æ˜¾ç¤º)
6. [å®Œæ•´å®æˆ˜æ¡ˆä¾‹](#6-å®Œæ•´å®æˆ˜æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡


**ç®€å•ç†è§£**ï¼šåœ¨çº¿ç”¨æˆ·ç»Ÿè®¡å°±æ˜¯**å®æ—¶è®°å½•å½“å‰æœ‰å¤šå°‘ç”¨æˆ·æ­£åœ¨ä½¿ç”¨ä½ çš„ç½‘ç«™**ã€‚

```
æƒ³è±¡ä¸€ä¸‹ç°å®åœºæ™¯ï¼š
å•†åœºç®¡ç†å‘˜ â†’ ç»Ÿè®¡å½“å‰å•†åœºå†…æœ‰å¤šå°‘é¡¾å®¢
ç½‘ç«™ç®¡ç†å‘˜ â†’ ç»Ÿè®¡å½“å‰ç½‘ç«™ä¸Šæœ‰å¤šå°‘ç”¨æˆ·

å®ç°åŸç†ï¼š
ç”¨æˆ·è®¿é—®ç½‘ç«™ â†’ åˆ›å»ºSession â†’ è®¡æ•°+1
ç”¨æˆ·ç¦»å¼€ç½‘ç«™ â†’ é”€æ¯Session â†’ è®¡æ•°-1
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡


**ğŸ¯ å®é™…åº”ç”¨ä»·å€¼**
- **ğŸ“Š è¿è¥ç›‘æ§**ï¼šäº†è§£ç½‘ç«™å®æ—¶è®¿é—®æƒ…å†µ
- **ğŸ”§ æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®åœ¨çº¿äººæ•°è°ƒæ•´æœåŠ¡å™¨èµ„æº
- **ğŸ‘¥ ç”¨æˆ·ä½“éªŒ**ï¼šæ˜¾ç¤º"å½“å‰åœ¨çº¿XXäºº"å¢åŠ æ´»è·ƒæ„Ÿ
- **ğŸš¨ å®‰å…¨é˜²æŠ¤**ï¼šç›‘æ§å¼‚å¸¸è®¿é—®å’Œæ¶æ„è¡Œä¸º

### 1.3 æŠ€æœ¯å®ç°æ€è·¯


**æ ¸å¿ƒå®ç°æ–¹æ¡ˆ**ï¼š
```
æŠ€æœ¯é€‰æ‹©ï¼šHttpSessionListener ç›‘å¬å™¨
å·¥ä½œåŸç†ï¼šç›‘å¬Sessionçš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶
è®¡æ•°é€»è¾‘ï¼šSessionåˆ›å»ºæ—¶+1ï¼Œé”€æ¯æ—¶-1
å­˜å‚¨æ–¹å¼ï¼šä½¿ç”¨é™æ€å˜é‡æˆ–ServletContextå­˜å‚¨è®¡æ•°
```

**ğŸ”¸ å®ç°æµç¨‹å›¾**
```
ç”¨æˆ·è®¿é—®é¡µé¢
     â†“
æœåŠ¡å™¨åˆ›å»ºSession
     â†“
è§¦å‘sessionCreatedäº‹ä»¶ â†’ åœ¨çº¿äººæ•°+1
     â†“
ç”¨æˆ·æ­£å¸¸ä½¿ç”¨ç½‘ç«™
     â†“
ç”¨æˆ·å…³é—­æµè§ˆå™¨/Sessionè¿‡æœŸ
     â†“
è§¦å‘sessionDestroyedäº‹ä»¶ â†’ åœ¨çº¿äººæ•°-1
```

---

## 2. ğŸ§ HttpSessionListenerç›‘å¬å™¨


### 2.1 HttpSessionListeneræ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼š`HttpSessionListener`å°±åƒä¸€ä¸ª**"é—¨å«"**ï¼Œä¸“é—¨ç›‘è§†Sessionçš„**"è¿›å‡º"**æƒ…å†µã€‚

```
ç°å®ç±»æ¯”ï¼š
å•†åœºé—¨å« â†’ è®°å½•é¡¾å®¢è¿›å‡ºå•†åœºçš„æƒ…å†µ
HttpSessionListener â†’ è®°å½•Sessionåˆ›å»ºå’Œé”€æ¯çš„æƒ…å†µ

ç›‘å¬å†…å®¹ï¼š
âœ… Sessionä»€ä¹ˆæ—¶å€™åˆ›å»ºäº†
âœ… Sessionä»€ä¹ˆæ—¶å€™é”€æ¯äº†
```

### 2.2 ç›‘å¬å™¨çš„ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•


**ğŸ“‹ æ ¸å¿ƒæ–¹æ³•è¯´æ˜**

| æ–¹æ³•å | **è§¦å‘æ—¶æœº** | **ä½œç”¨** | **å‚æ•°** |
|--------|------------|---------|----------|
| `sessionCreated` | Session**åˆšåˆ›å»º**æ—¶ | ç”¨æˆ·**è¿›å…¥**ç½‘ç«™ | `HttpSessionEvent` |
| `sessionDestroyed` | Session**è¢«é”€æ¯**æ—¶ | ç”¨æˆ·**ç¦»å¼€**ç½‘ç«™ | `HttpSessionEvent` |

### 2.3 åŸºç¡€ç›‘å¬å™¨å®ç°


```java
// å®ç°HttpSessionListeneræ¥å£
@WebListener  // æ³¨è§£æ–¹å¼æ³¨å†Œç›‘å¬å™¨
public class OnlineUserListener implements HttpSessionListener {
    
    // Sessionåˆ›å»ºæ—¶è°ƒç”¨
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        System.out.println("æœ‰æ–°ç”¨æˆ·è¿›å…¥ç½‘ç«™ï¼");
        System.out.println("Session ID: " + se.getSession().getId());
    }
    
    // Sessioné”€æ¯æ—¶è°ƒç”¨
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        System.out.println("ç”¨æˆ·ç¦»å¼€ç½‘ç«™ï¼");
        System.out.println("Session ID: " + se.getSession().getId());
    }
}
```

**ğŸ”¸ å…³é”®ç†è§£ç‚¹**
- `@WebListener`ï¼šå‘Šè¯‰æœåŠ¡å™¨è¿™æ˜¯ä¸ªç›‘å¬å™¨ï¼Œè‡ªåŠ¨æ³¨å†Œ
- `HttpSessionEvent se`ï¼šäº‹ä»¶å¯¹è±¡ï¼ŒåŒ…å«Sessionä¿¡æ¯
- `se.getSession()`ï¼šè·å–è§¦å‘äº‹ä»¶çš„Sessionå¯¹è±¡

---

## 3. ğŸ”„ Sessionç”Ÿå‘½å‘¨æœŸç›‘å¬


### 3.1 Sessionä»€ä¹ˆæ—¶å€™åˆ›å»º


**ğŸ¯ Sessionåˆ›å»ºæ—¶æœº**
```
ç”¨æˆ·è¡Œä¸º                     SessionçŠ¶æ€
é¦–æ¬¡è®¿é—®ç½‘ç«™          â†’     åˆ›å»ºæ–°Session
è°ƒç”¨request.getSession()  â†’     å¦‚æœæ²¡æœ‰åˆ™åˆ›å»º
JSPé¡µé¢é»˜è®¤è¡Œä¸º       â†’     è‡ªåŠ¨åˆ›å»ºSession
```

**ğŸ’¡ å®é™…åœºæ™¯ç¤ºä¾‹**
```java
// è¿™äº›æ“ä½œä¼šåˆ›å»ºSession
HttpSession session = request.getSession();     // è·å–æˆ–åˆ›å»º
session.setAttribute("username", "å¼ ä¸‰");        // å­˜å‚¨æ•°æ®
```

### 3.2 Sessionä»€ä¹ˆæ—¶å€™é”€æ¯


**â° Sessioné”€æ¯æ—¶æœº**

| é”€æ¯åŸå›  | **è¯´æ˜** | **å¸¸è§æƒ…å†µ** |
|---------|---------|-------------|
| **è¶…æ—¶é”€æ¯** | è¶…è¿‡è®¾å®šæ—¶é—´æ— æ´»åŠ¨ | ç”¨æˆ·é•¿æ—¶é—´ä¸æ“ä½œ |
| **æ‰‹åŠ¨é”€æ¯** | ç¨‹åºä¸»åŠ¨è°ƒç”¨invalidate() | ç”¨æˆ·é€€å‡ºç™»å½• |
| **æœåŠ¡å™¨é‡å¯** | æœåŠ¡å™¨å…³é—­æˆ–é‡å¯ | ç»´æŠ¤æˆ–æ•…éšœ |
| **æµè§ˆå™¨å…³é—­** | æµè§ˆå™¨å®Œå…¨å…³é—­ | ç”¨æˆ·å…³é—­æ‰€æœ‰æ ‡ç­¾é¡µ |

### 3.3 ç›‘å¬Sessionç”Ÿå‘½å‘¨æœŸ


```java
@WebListener
public class SessionLifecycleListener implements HttpSessionListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        
        // è®°å½•Sessionåˆ›å»ºä¿¡æ¯
        System.out.println("=== Sessionåˆ›å»º ===");
        System.out.println("Session ID: " + session.getId());
        System.out.println("åˆ›å»ºæ—¶é—´: " + new Date(session.getCreationTime()));
        System.out.println("æœ€å¤§å­˜æ´»æ—¶é—´: " + session.getMaxInactiveInterval() + "ç§’");
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        
        // è®°å½•Sessioné”€æ¯ä¿¡æ¯
        System.out.println("=== Sessioné”€æ¯ ===");
        System.out.println("Session ID: " + session.getId());
        System.out.println("æœ€åè®¿é—®æ—¶é—´: " + new Date(session.getLastAccessedTime()));
    }
}
```

---

## 4. ğŸ”¢ åœ¨çº¿ç”¨æˆ·è®¡æ•°å®ç°


### 4.1 è®¡æ•°å™¨è®¾è®¡æ€è·¯


**ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™**
- **çº¿ç¨‹å®‰å…¨**ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®ï¼Œéœ€è¦ä¿è¯è®¡æ•°å‡†ç¡®
- **å…¨å±€å…±äº«**ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„åœ¨çº¿äººæ•°
- **å®æ—¶æ›´æ–°**ï¼šSessionåˆ›å»º/é”€æ¯ç«‹å³æ›´æ–°è®¡æ•°

### 4.2 ä½¿ç”¨é™æ€å˜é‡å®ç°è®¡æ•°


```java
@WebListener
public class OnlineUserCounter implements HttpSessionListener {
    
    // ä½¿ç”¨AtomicIntegerä¿è¯çº¿ç¨‹å®‰å…¨
    private static AtomicInteger onlineCount = new AtomicInteger(0);
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        // åœ¨çº¿äººæ•°+1
        int count = onlineCount.incrementAndGet();
        System.out.println("æ–°ç”¨æˆ·è¿›å…¥ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + count);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        // åœ¨çº¿äººæ•°-1
        int count = onlineCount.decrementAndGet();
        System.out.println("ç”¨æˆ·ç¦»å¼€ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + count);
        
        // é˜²æ­¢è®¡æ•°ä¸ºè´Ÿæ•°
        if (count < 0) {
            onlineCount.set(0);
        }
    }
    
    // æä¾›é™æ€æ–¹æ³•è·å–åœ¨çº¿äººæ•°
    public static int getOnlineCount() {
        return onlineCount.get();
    }
}
```

**ğŸ”¸ å…³é”®æŠ€æœ¯ç‚¹**
- `AtomicInteger`ï¼š**åŸå­æ“ä½œç±»**ï¼Œä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è®¡æ•°å‡†ç¡®
- `incrementAndGet()`ï¼š**åŸå­é€’å¢**ï¼Œç›¸å½“äºçº¿ç¨‹å®‰å…¨çš„ ++count
- `decrementAndGet()`ï¼š**åŸå­é€’å‡**ï¼Œç›¸å½“äºçº¿ç¨‹å®‰å…¨çš„ --count

### 4.3 ä½¿ç”¨ServletContextå®ç°è®¡æ•°


```java
@WebListener
public class OnlineUserCounterV2 implements HttpSessionListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        ServletContext context = se.getSession().getServletContext();
        
        // ä»ServletContextè·å–å½“å‰è®¡æ•°
        Integer count = (Integer) context.getAttribute("onlineCount");
        if (count == null) {
            count = 0;
        }
        
        // è®¡æ•°+1å¹¶ä¿å­˜
        count++;
        context.setAttribute("onlineCount", count);
        
        System.out.println("å½“å‰åœ¨çº¿äººæ•°ï¼š" + count);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        ServletContext context = se.getSession().getServletContext();
        
        // è·å–å½“å‰è®¡æ•°å¹¶-1
        Integer count = (Integer) context.getAttribute("onlineCount");
        if (count != null && count > 0) {
            count--;
            context.setAttribute("onlineCount", count);
        }
        
        System.out.println("å½“å‰åœ¨çº¿äººæ•°ï¼š" + count);
    }
}
```

**âš–ï¸ ä¸¤ç§æ–¹å¼å¯¹æ¯”**

| å®ç°æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **é™æ€å˜é‡** | ç®€å•é«˜æ•ˆï¼Œçº¿ç¨‹å®‰å…¨ | æœåŠ¡å™¨é‡å¯ä¸¢å¤± | ç®€å•åº”ç”¨ |
| **ServletContext** | å…¨å±€å…±äº«ï¼Œæ˜“äºè®¿é—® | éœ€è¦åŒæ­¥å¤„ç† | å¤æ‚åº”ç”¨ |

---

## 5. ğŸ“Š å®æ—¶ç»Ÿè®¡æ˜¾ç¤º


### 5.1 åœ¨JSPé¡µé¢æ˜¾ç¤ºåœ¨çº¿äººæ•°


**ğŸ“„ ç®€å•æ˜¾ç¤ºæ–¹å¼**
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<!DOCTYPE html>
<html>
<head>
    <title>åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡</title>
</head>
<body>
    <div class="online-stats">
        <h3>ğŸ“Š å®æ—¶ç»Ÿè®¡</h3>
        <!-- ä½¿ç”¨ELè¡¨è¾¾å¼è·å–åœ¨çº¿äººæ•° -->
        <p>ğŸŸ¢ å½“å‰åœ¨çº¿ç”¨æˆ·ï¼š<strong>${applicationScope.onlineCount}</strong> äºº</p>
        <p>â° ç»Ÿè®¡æ—¶é—´ï¼š<%= new java.util.Date() %></p>
    </div>
</body>
</html>
```

### 5.2 é€šè¿‡Servletæä¾›ç»Ÿè®¡æ¥å£


```java
@WebServlet("/api/online-stats")
public class OnlineStatsServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // è®¾ç½®å“åº”ç±»å‹ä¸ºJSON
        response.setContentType("application/json;charset=UTF-8");
        
        // è·å–åœ¨çº¿äººæ•°
        int onlineCount = OnlineUserCounter.getOnlineCount();
        
        // æ„å»ºJSONå“åº”
        String jsonResponse = String.format(
            "{\"onlineCount\": %d, \"timestamp\": %d}", 
            onlineCount, System.currentTimeMillis()
        );
        
        response.getWriter().write(jsonResponse);
    }
}
```

### 5.3 å‰ç«¯å®æ—¶åˆ·æ–°æ˜¾ç¤º


```html
<!DOCTYPE html>
<html>
<head>
    <title>å®æ—¶åœ¨çº¿ç»Ÿè®¡</title>
    <style>
        .stats-panel {
            border: 2px solid #4CAF50;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .online-count {
            font-size: 2em;
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="stats-panel">
        <h3>ğŸ“ˆ å®æ—¶åœ¨çº¿ç»Ÿè®¡</h3>
        <div class="online-count" id="onlineCount">åŠ è½½ä¸­...</div>
        <p>ğŸ”„ æ¯5ç§’è‡ªåŠ¨åˆ·æ–°</p>
    </div>

    <script>
        // å®šæ—¶æ›´æ–°åœ¨çº¿äººæ•°
        function updateOnlineCount() {
            fetch('/api/online-stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('onlineCount').textContent = 
                        data.onlineCount + ' äººåœ¨çº¿';
                })
                .catch(error => {
                    document.getElementById('onlineCount').textContent = 'è·å–å¤±è´¥';
                });
        }
        
        // é¡µé¢åŠ è½½åç«‹å³æ›´æ–°
        updateOnlineCount();
        
        // æ¯5ç§’æ›´æ–°ä¸€æ¬¡
        setInterval(updateOnlineCount, 5000);
    </script>
</body>
</html>
```

---

## 6. ğŸš€ å®Œæ•´å®æˆ˜æ¡ˆä¾‹


### 6.1 å¢å¼ºç‰ˆåœ¨çº¿ç”¨æˆ·ç»Ÿè®¡å™¨


```java
@WebListener
public class AdvancedOnlineUserCounter implements HttpSessionListener {
    
    // åœ¨çº¿ç”¨æˆ·è®¡æ•°
    private static AtomicInteger onlineCount = new AtomicInteger(0);
    
    // æ€»è®¿é—®è®¡æ•°
    private static AtomicLong totalVisits = new AtomicLong(0);
    
    // ä»Šæ—¥è®¿é—®è®¡æ•°
    private static AtomicInteger todayVisits = new AtomicInteger(0);
    private static String todayDate = getTodayDate();
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        // åœ¨çº¿äººæ•°+1
        int online = onlineCount.incrementAndGet();
        
        // æ€»è®¿é—®æ•°+1
        long total = totalVisits.incrementAndGet();
        
        // ä»Šæ—¥è®¿é—®æ•°+1
        checkAndResetTodayCounter();
        int today = todayVisits.incrementAndGet();
        
        // å°†ç»Ÿè®¡æ•°æ®å­˜å‚¨åˆ°ServletContext
        ServletContext context = se.getSession().getServletContext();
        context.setAttribute("onlineCount", online);
        context.setAttribute("totalVisits", total);
        context.setAttribute("todayVisits", today);
        
        // è®°å½•ç”¨æˆ·ä¿¡æ¯
        HttpSession session = se.getSession();
        session.setAttribute("loginTime", new Date());
        
        System.out.println("=== ç”¨æˆ·è¿›å…¥ç½‘ç«™ ===");
        System.out.println("åœ¨çº¿äººæ•°: " + online);
        System.out.println("æ€»è®¿é—®: " + total);
        System.out.println("ä»Šæ—¥è®¿é—®: " + today);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        // åœ¨çº¿äººæ•°-1
        int online = onlineCount.decrementAndGet();
        if (online < 0) {
            online = 0;
            onlineCount.set(0);
        }
        
        // æ›´æ–°ServletContext
        ServletContext context = se.getSession().getServletContext();
        context.setAttribute("onlineCount", online);
        
        // è®¡ç®—ç”¨æˆ·åœ¨çº¿æ—¶é•¿
        HttpSession session = se.getSession();
        Date loginTime = (Date) session.getAttribute("loginTime");
        if (loginTime != null) {
            long duration = (System.currentTimeMillis() - loginTime.getTime()) / 1000;
            System.out.println("ç”¨æˆ·åœ¨çº¿æ—¶é•¿: " + duration + " ç§’");
        }
        
        System.out.println("ç”¨æˆ·ç¦»å¼€ï¼Œå½“å‰åœ¨çº¿: " + online);
    }
    
    // æ£€æŸ¥æ—¥æœŸå˜åŒ–ï¼Œé‡ç½®ä»Šæ—¥è®¡æ•°
    private void checkAndResetTodayCounter() {
        String currentDate = getTodayDate();
        if (!currentDate.equals(todayDate)) {
            todayDate = currentDate;
            todayVisits.set(0);
        }
    }
    
    // è·å–ä»Šæ—¥æ—¥æœŸå­—ç¬¦ä¸²
    private static String getTodayDate() {
        return new SimpleDateFormat("yyyy-MM-dd").format(new Date());
    }
    
    // æä¾›è·å–ç»Ÿè®¡æ•°æ®çš„é™æ€æ–¹æ³•
    public static Map<String, Object> getStatistics() {
        Map<String, Object> stats = new HashMap<>();
        stats.put("onlineCount", onlineCount.get());
        stats.put("totalVisits", totalVisits.get());
        stats.put("todayVisits", todayVisits.get());
        stats.put("date", getTodayDate());
        return stats;
    }
}
```

### 6.2 ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºé¡µé¢


```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç½‘ç«™ç»Ÿè®¡ä¸­å¿ƒ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .stats-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .stats-card { 
            border: 1px solid #ddd; 
            padding: 20px; 
            border-radius: 8px; 
            min-width: 200px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stats-number { 
            font-size: 2em; 
            font-weight: bold; 
            color: #2196F3; 
        }
        .stats-label { 
            color: #666; 
            font-size: 0.9em; 
        }
        .online { color: #4CAF50; }
        .total { color: #FF9800; }
        .today { color: #9C27B0; }
        .refresh-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š ç½‘ç«™å®æ—¶ç»Ÿè®¡</h1>
    
    <button class="refresh-btn" onclick="location.reload()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
    
    <div class="stats-container">
        <!-- åœ¨çº¿ç”¨æˆ·å¡ç‰‡ -->
        <div class="stats-card">
            <div class="stats-number online">${applicationScope.onlineCount}</div>
            <div class="stats-label">ğŸŸ¢ å½“å‰åœ¨çº¿ç”¨æˆ·</div>
        </div>
        
        <!-- æ€»è®¿é—®é‡å¡ç‰‡ -->
        <div class="stats-card">
            <div class="stats-number total">${applicationScope.totalVisits}</div>
            <div class="stats-label">ğŸ“ˆ æ€»è®¿é—®é‡</div>
        </div>
        
        <!-- ä»Šæ—¥è®¿é—®å¡ç‰‡ -->
        <div class="stats-card">
            <div class="stats-number today">${applicationScope.todayVisits}</div>
            <div class="stats-label">ğŸ“… ä»Šæ—¥è®¿é—®</div>
        </div>
        
        <!-- å½“å‰æ—¶é—´å¡ç‰‡ -->
        <div class="stats-card">
            <div class="stats-number" style="font-size: 1.2em;">
                <%= new java.text.SimpleDateFormat("HH:mm:ss").format(new Date()) %>
            </div>
            <div class="stats-label">â° å½“å‰æ—¶é—´</div>
        </div>
    </div>
    
    <div style="margin-top: 30px;">
        <h3>ğŸ“‹ ä¼šè¯ä¿¡æ¯</h3>
        <p><strong>ä¼šè¯IDï¼š</strong><%= session.getId() %></p>
        <p><strong>åˆ›å»ºæ—¶é—´ï¼š</strong><%= new Date(session.getCreationTime()) %></p>
        <p><strong>æœ€åè®¿é—®ï¼š</strong><%= new Date(session.getLastAccessedTime()) %></p>
        <p><strong>æœ€å¤§å­˜æ´»æ—¶é—´ï¼š</strong><%= session.getMaxInactiveInterval() %> ç§’</p>
    </div>
    
    <script>
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°é¡µé¢
        setTimeout(function() {
            location.reload();
        }, 30000);
    </script>
</body>
</html>
```

### 6.3 é…ç½®æ–‡ä»¶å¢å¼º


```xml
<!-- web.xml é…ç½®Sessionè¶…æ—¶æ—¶é—´ -->
<web-app>
    <!-- Sessioné…ç½®ï¼š15åˆ†é’Ÿè¶…æ—¶ -->
    <session-config>
        <session-timeout>15</session-timeout>
    </session-config>
    
    <!-- æ¬¢è¿é¡µé¢ -->
    <welcome-file-list>
        <welcome-file>stats.jsp</welcome-file>
    </welcome-file-list>
</web-app>
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ HttpSessionListenerï¼šSessionç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨
ğŸ”¸ sessionCreatedï¼šSessionåˆ›å»ºæ—¶è§¦å‘ï¼Œç”¨äºè®¡æ•°+1
ğŸ”¸ sessionDestroyedï¼šSessioné”€æ¯æ—¶è§¦å‘ï¼Œç”¨äºè®¡æ•°-1
ğŸ”¸ çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨AtomicIntegerä¿è¯è®¡æ•°å‡†ç¡®æ€§
ğŸ”¸ å…¨å±€å…±äº«ï¼šé€šè¿‡ServletContextæˆ–é™æ€å˜é‡å­˜å‚¨è®¡æ•°
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Sessionç›‘å¬åŸç†**
```
ç›‘å¬æ—¶æœºï¼š
Sessionåˆ›å»º â†’ ç”¨æˆ·é¦–æ¬¡è®¿é—®/è·å–Session
Sessioné”€æ¯ â†’ è¶…æ—¶/æ‰‹åŠ¨é”€æ¯/æœåŠ¡å™¨å…³é—­

è®¡æ•°é€»è¾‘ï¼š
åˆ›å»ºæ—¶+1 â†’ æ–°ç”¨æˆ·è¿›å…¥
é”€æ¯æ—¶-1 â†’ ç”¨æˆ·ç¦»å¼€

å­˜å‚¨æ–¹å¼ï¼š
é™æ€å˜é‡ â†’ ç®€å•é«˜æ•ˆ
ServletContext â†’ å…¨å±€å…±äº«
```

**ğŸ”¹ çº¿ç¨‹å®‰å…¨çš„é‡è¦æ€§**
```
é—®é¢˜åœºæ™¯ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®
æ™®é€šintå˜é‡ï¼šå¯èƒ½è®¡æ•°é”™è¯¯
AtomicIntegerï¼šä¿è¯åŸå­æ“ä½œ
synchronizedï¼šä¼ ç»ŸåŒæ­¥æ–¹å¼
```

**ğŸ”¹ å®é™…åº”ç”¨è€ƒè™‘**
```
å‡†ç¡®æ€§ï¼šSessioné”€æ¯æ—¶æœºçš„æŠŠæ¡
æ€§èƒ½ï¼šé¿å…é¢‘ç¹æ•°æ®åº“æ“ä½œ
ç”¨æˆ·ä½“éªŒï¼šå®æ—¶æ›´æ–°æ˜¾ç¤º
æ‰©å±•æ€§ï¼šæ”¯æŒæ›´å¤šç»Ÿè®¡ç»´åº¦
```

### 7.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ’¼ å•†ä¸šåº”ç”¨**
- **ç”µå•†ç½‘ç«™**ï¼šæ˜¾ç¤º"å½“å‰XXäººæ­£åœ¨è´­ç‰©"
- **åœ¨çº¿æ•™è‚²**ï¼šç»Ÿè®¡è¯¾ç¨‹å­¦ä¹ äººæ•°
- **ç¤¾äº¤å¹³å°**ï¼šæ˜¾ç¤ºåœ¨çº¿å¥½å‹æ•°é‡
- **æ¸¸æˆç½‘ç«™**ï¼šç»Ÿè®¡åŒæ—¶åœ¨çº¿ç©å®¶

**ğŸ”§ æŠ€æœ¯åº”ç”¨**
- **ç³»ç»Ÿç›‘æ§**ï¼šæœåŠ¡å™¨è´Ÿè½½è¯„ä¼°
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ®åœ¨çº¿äººæ•°è°ƒæ•´èµ„æº
- **å®‰å…¨é˜²æŠ¤**ï¼šæ£€æµ‹å¼‚å¸¸è®¿é—®æ¨¡å¼

### 7.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**â“ å¸¸è§é—®é¢˜**
```
Q: è®¡æ•°ä¸å‡†ç¡®æ€ä¹ˆåŠï¼Ÿ
A: ä½¿ç”¨AtomicIntegerï¼Œæ³¨æ„Sessionè¶…æ—¶è®¾ç½®

Q: æœåŠ¡å™¨é‡å¯åè®¡æ•°æ¸…é›¶ï¼Ÿ
A: å¯ä»¥ç»“åˆæ•°æ®åº“æŒä¹…åŒ–å­˜å‚¨

Q: ç”¨æˆ·å…³é—­æµè§ˆå™¨è®¡æ•°ä¸å‡å°‘ï¼Ÿ
A: ä¾èµ–Sessionè¶…æ—¶æœºåˆ¶ï¼Œè®¾ç½®åˆç†è¶…æ—¶æ—¶é—´

Q: å¦‚ä½•åŒºåˆ†çœŸå®ç”¨æˆ·å’Œçˆ¬è™«ï¼Ÿ
A: ç»“åˆç”¨æˆ·è¡Œä¸ºåˆ†æï¼Œè¿‡æ»¤å¼‚å¸¸è®¿é—®
```

**ğŸ’¡ æœ€ä½³å®è·µ**
- åˆç†è®¾ç½®Sessionè¶…æ—¶æ—¶é—´
- ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨
- æä¾›å¤šç»´åº¦ç»Ÿè®¡ä¿¡æ¯
- è€ƒè™‘æ•°æ®æŒä¹…åŒ–éœ€æ±‚
- æ·»åŠ å¼‚å¸¸å¤„ç†æœºåˆ¶

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç›‘å¬å™¨å®ˆæŠ¤Sessionç”Ÿå‘½å‘¨æœŸ
- åˆ›å»ºåŠ ä¸€é”€æ¯å‡ä¸€å¾ˆç®€å•  
- çº¿ç¨‹å®‰å…¨è®¡æ•°æ˜¯å…³é”®
- å®æ—¶ç»Ÿè®¡æå‡ç”¨æˆ·ä½“éªŒ