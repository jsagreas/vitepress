---
title: 1ã€ç”¨æˆ·ç™»å½•ç³»ç»Ÿå®ç°
---
## ğŸ“š ç›®å½•

1. [ç”¨æˆ·ç™»å½•ç³»ç»Ÿæ¦‚è¿°](#1-ç”¨æˆ·ç™»å½•ç³»ç»Ÿæ¦‚è¿°)
2. [ç™»å½•éªŒè¯é€»è¾‘è¯¦è§£](#2-ç™»å½•éªŒè¯é€»è¾‘è¯¦è§£)
3. [Sessionå­˜å‚¨ç”¨æˆ·ä¿¡æ¯](#3-sessionå­˜å‚¨ç”¨æˆ·ä¿¡æ¯)
4. [ç™»å½•çŠ¶æ€åˆ¤æ–­æœºåˆ¶](#4-ç™»å½•çŠ¶æ€åˆ¤æ–­æœºåˆ¶)
5. [è‡ªåŠ¨ç™»å½•å®ç°åŸç†](#5-è‡ªåŠ¨ç™»å½•å®ç°åŸç†)
6. [å®‰å…¨é€€å‡ºå¤„ç†](#6-å®‰å…¨é€€å‡ºå¤„ç†)
7. [å®Œæ•´ç™»å½•ç³»ç»Ÿæ¡ˆä¾‹](#7-å®Œæ•´ç™»å½•ç³»ç»Ÿæ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç”¨æˆ·ç™»å½•ç³»ç»Ÿæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç”¨æˆ·ç™»å½•ç³»ç»Ÿ


**é€šä¿—ç†è§£**ï¼šå°±åƒè¿›å…¥å°åŒºéœ€è¦åˆ·å¡ä¸€æ ·ï¼Œç”¨æˆ·ç™»å½•ç³»ç»Ÿå°±æ˜¯ç½‘ç«™çš„"é—¨ç¦ç³»ç»Ÿ"

```
ç°å®ç”Ÿæ´»ä¸­ï¼š
å±…æ°‘ â†’ åˆ·é—¨ç¦å¡ â†’ éªŒè¯èº«ä»½ â†’ è¿›å…¥å°åŒº â†’ åœ¨å°åŒºå†…è‡ªç”±æ´»åŠ¨

ç½‘ç«™ç™»å½•ä¸­ï¼š
ç”¨æˆ· â†’ è¾“å…¥è´¦å·å¯†ç  â†’ éªŒè¯èº«ä»½ â†’ ç™»å½•æˆåŠŸ â†’ è®¿é—®å„ç§åŠŸèƒ½é¡µé¢
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **èº«ä»½è¯†åˆ«**ï¼šç¡®è®¤"ä½ æ˜¯è°"
- ğŸ”¸ **æƒé™æ§åˆ¶**ï¼šå†³å®š"ä½ èƒ½åšä»€ä¹ˆ" 
- ğŸ”¸ **çŠ¶æ€ä¿æŒ**ï¼šè®°ä½"ä½ å·²ç»ç™»å½•äº†"
- ğŸ”¸ **å®‰å…¨ä¿éšœ**ï¼šé˜²æ­¢"åäººå†’å……ä½ "

### 1.2 ç™»å½•ç³»ç»Ÿçš„å·¥ä½œæµç¨‹


**æ•´ä½“æµç¨‹å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¿é—®   â”‚â”€â”€â”€â†’â”‚  ç™»å½•é¡µé¢   â”‚â”€â”€â”€â†’â”‚  è¾“å…¥è´¦å¯†   â”‚
â”‚  ç½‘ç«™é¦–é¡µ   â”‚    â”‚  login.jsp  â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç™»å½•æˆåŠŸ   â”‚â†â”€â”€â”€â”‚  éªŒè¯é€šè¿‡   â”‚â†â”€â”€â”€â”‚  åç«¯éªŒè¯   â”‚
â”‚  è·³è½¬é¦–é¡µ   â”‚    â”‚  åˆ›å»ºSession â”‚    â”‚  LoginServletâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯¦ç»†æ­¥éª¤è¯´æ˜**ï¼š
1. **æ­¥éª¤ â‘ **ï¼šç”¨æˆ·æ‰“å¼€ç½‘ç«™ï¼Œå‘ç°éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨
2. **æ­¥éª¤ â‘¡**ï¼šç³»ç»Ÿè·³è½¬åˆ°ç™»å½•é¡µé¢
3. **æ­¥éª¤ â‘¢**ï¼šç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
4. **æ­¥éª¤ â‘£**ï¼šåç«¯éªŒè¯è´¦å·å¯†ç æ˜¯å¦æ­£ç¡®
5. **æ­¥éª¤ â‘¤**ï¼šéªŒè¯æˆåŠŸååˆ›å»ºSessionï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯
6. **æ­¥éª¤ â‘¥**ï¼šè·³è½¬åˆ°é¦–é¡µæˆ–ç”¨æˆ·æƒ³è®¿é—®çš„é¡µé¢

---

## 2. âœ… ç™»å½•éªŒè¯é€»è¾‘è¯¦è§£


### 2.1 éªŒè¯é€»è¾‘çš„æ ¸å¿ƒæ€è·¯


**ç®€å•æ¯”å–»**ï¼šå°±åƒé“¶è¡ŒæŸœå‘˜éªŒè¯ä½ çš„èº«ä»½è¯ä¸€æ ·

```
é“¶è¡ŒéªŒè¯æµç¨‹ï¼š
1. ä½ è¯´ï¼š"æˆ‘æ˜¯å¼ ä¸‰"
2. æŸœå‘˜è¯´ï¼š"è¯·å‡ºç¤ºèº«ä»½è¯"
3. æŸœå‘˜æ ¸å¯¹ï¼šèº«ä»½è¯ä¸Šçš„ä¿¡æ¯ vs ä½ æœ¬äºº
4. æ ¸å¯¹æˆåŠŸï¼šåŠç†ä¸šåŠ¡
5. æ ¸å¯¹å¤±è´¥ï¼šæ‹’ç»æœåŠ¡

ç½‘ç«™éªŒè¯æµç¨‹ï¼š
1. ç”¨æˆ·è¯´ï¼š"æˆ‘æ˜¯admin"
2. ç³»ç»Ÿè¯´ï¼š"è¯·è¾“å…¥å¯†ç "
3. ç³»ç»Ÿæ ¸å¯¹ï¼šæ•°æ®åº“ä¸­çš„å¯†ç  vs ç”¨æˆ·è¾“å…¥çš„å¯†ç 
4. æ ¸å¯¹æˆåŠŸï¼šåˆ›å»ºç™»å½•Session
5. æ ¸å¯¹å¤±è´¥ï¼šè¿”å›ç™»å½•é¡µé¢
```

### 2.2 éªŒè¯é€»è¾‘å®ç°æ­¥éª¤


**ğŸŸ¢ åŸºç¡€çº§åˆ«** - éªŒè¯æ ¸å¿ƒé€»è¾‘ï¼š

```java
// LoginServlet.java - å¤„ç†ç™»å½•éªŒè¯
protected void doPost(HttpServletRequest request, HttpServletResponse response) {
    // 1. è·å–ç”¨æˆ·è¾“å…¥çš„è´¦å·å¯†ç 
    String username = request.getParameter("username");
    String password = request.getParameter("password");
    
    // 2. è°ƒç”¨ä¸šåŠ¡å±‚éªŒè¯ç”¨æˆ·
    UserService userService = new UserService();
    User user = userService.login(username, password);
    
    // 3. æ ¹æ®éªŒè¯ç»“æœå¤„ç†
    if (user != null) {
        // éªŒè¯æˆåŠŸ - åˆ›å»ºSessionä¿å­˜ç”¨æˆ·ä¿¡æ¯
        HttpSession session = request.getSession();
        session.setAttribute("loginUser", user);
        
        // è·³è½¬åˆ°é¦–é¡µ
        response.sendRedirect("index.jsp");
    } else {
        // éªŒè¯å¤±è´¥ - è¿”å›ç™»å½•é¡µé¢å¹¶æç¤ºé”™è¯¯
        request.setAttribute("errorMsg", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        request.getRequestDispatcher("login.jsp").forward(request, response);
    }
}
```

**ğŸ’¡ éªŒè¯é€»è¾‘è¯¦è§£**ï¼š

| éªŒè¯æ­¥éª¤ | **ä½œç”¨è¯´æ˜** | **å°±åƒç°å®ä¸­** |
|---------|-------------|---------------|
| `è·å–å‚æ•°` | `ä»å‰ç«¯é¡µé¢è·å–ç”¨æˆ·è¾“å…¥` | `æŸœå‘˜æ¥æ”¶ä½ çš„èº«ä»½è¯` |
| `è°ƒç”¨ä¸šåŠ¡å±‚` | `å»æ•°æ®åº“æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯` | `æŸœå‘˜åœ¨ç³»ç»Ÿä¸­æŸ¥ä½ çš„èµ„æ–™` |
| `æ¯”å¯¹ä¿¡æ¯` | `å¯¹æ¯”æ•°æ®åº“å¯†ç å’Œè¾“å…¥å¯†ç ` | `æ¯”å¯¹èº«ä»½è¯ä¿¡æ¯å’Œæœ¬äºº` |
| `åˆ›å»ºSession` | `éªŒè¯æˆåŠŸåè®°å½•ç™»å½•çŠ¶æ€` | `ç»™ä½ åŠäº‹çš„å‡­æ¡` |
| `è·³è½¬é¡µé¢` | `æ ¹æ®éªŒè¯ç»“æœå†³å®šå»å“ª` | `æˆåŠŸåŠä¸šåŠ¡/å¤±è´¥è¯·é‡è¯•` |

### 2.3 ä¸šåŠ¡å±‚éªŒè¯å®ç°


```java
// UserService.java - ä¸šåŠ¡é€»è¾‘å±‚
public User login(String username, String password) {
    // 1. å‚æ•°æ ¡éªŒ
    if (username == null || password == null || 
        username.trim().isEmpty() || password.trim().isEmpty()) {
        return null; // å‚æ•°ä¸å®Œæ•´
    }
    
    // 2. æŸ¥è¯¢æ•°æ®åº“
    UserDao userDao = new UserDao();
    User user = userDao.findByUsername(username);
    
    // 3. éªŒè¯å¯†ç 
    if (user != null && password.equals(user.getPassword())) {
        return user; // éªŒè¯æˆåŠŸ
    }
    
    return null; // éªŒè¯å¤±è´¥
}
```

**ğŸ”’ å®‰å…¨å¢å¼ºç‰ˆæœ¬**ï¼š

```java
public User login(String username, String password) {
    // åŸºç¡€éªŒè¯ + å®‰å…¨å¢å¼º
    if (username == null || password == null) return null;
    
    UserDao userDao = new UserDao();
    User user = userDao.findByUsername(username);
    
    if (user != null) {
        // å¯†ç åŠ å¯†æ¯”å¯¹ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥ç”¨MD5æˆ–SHA256ï¼‰
        String encryptedPassword = MD5Utils.encrypt(password);
        if (encryptedPassword.equals(user.getPassword())) {
            // æ›´æ–°æœ€åç™»å½•æ—¶é—´
            user.setLastLoginTime(new Date());
            userDao.updateLastLoginTime(user.getId());
            return user;
        }
    }
    
    return null;
}
```

---

## 3. ğŸ’¾ Sessionå­˜å‚¨ç”¨æˆ·ä¿¡æ¯


### 3.1 ä¸ºä»€ä¹ˆè¦ç”¨Sessionå­˜å‚¨


**ç°å®æ¯”å–»**ï¼šå°±åƒé…’åº—ç»™ä½ æˆ¿å¡ä¸€æ ·

```
é…’åº—å…¥ä½æµç¨‹ï¼š
1. ä½ åœ¨å‰å°ç™»è®°å…¥ä½ï¼ˆç›¸å½“äºç™»å½•éªŒè¯ï¼‰
2. å‰å°ç»™ä½ æˆ¿å¡ï¼ˆç›¸å½“äºåˆ›å»ºSessionï¼‰
3. ä½ æ‹¿ç€æˆ¿å¡å¯ä»¥ï¼š
   - è¿›å…¥è‡ªå·±æˆ¿é—´
   - ä½¿ç”¨é…’åº—è®¾æ–½
   - è¯æ˜ä½ æ˜¯ä½å®¢
4. é€€æˆ¿æ—¶äº¤è¿˜æˆ¿å¡ï¼ˆç›¸å½“äºé€€å‡ºç™»å½•ï¼‰

Sessionå·¥ä½œæœºåˆ¶ï¼š
1. ç”¨æˆ·ç™»å½•éªŒè¯æˆåŠŸ
2. æœåŠ¡å™¨åˆ›å»ºSessionå¹¶è¿”å›SessionID
3. ç”¨æˆ·åç»­è®¿é—®æºå¸¦SessionIDå¯ä»¥ï¼š
   - è®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢
   - è·å–ä¸ªäººä¿¡æ¯
   - è¯æ˜å·²ç»ç™»å½•
4. é€€å‡ºç™»å½•æ—¶é”€æ¯Session
```

### 3.2 Sessionå­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æ–¹å¼


**ğŸ”¸ å­˜å‚¨å®Œæ•´ç”¨æˆ·å¯¹è±¡**ï¼š
```java
// ç™»å½•æˆåŠŸåå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
HttpSession session = request.getSession();

// æ–¹å¼1ï¼šå­˜å‚¨å®Œæ•´ç”¨æˆ·å¯¹è±¡ï¼ˆæ¨èï¼‰
session.setAttribute("loginUser", user);

// æ–¹å¼2ï¼šåˆ†åˆ«å­˜å‚¨ç”¨æˆ·å±æ€§ï¼ˆä¸æ¨èï¼‰
session.setAttribute("userId", user.getId());
session.setAttribute("username", user.getUsername());
session.setAttribute("userRole", user.getRole());
```

**ğŸ”¸ è·å–å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯**ï¼š
```java
// åœ¨å…¶ä»–Servletä¸­è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯
HttpSession session = request.getSession();
User loginUser = (User) session.getAttribute("loginUser");

if (loginUser != null) {
    // ç”¨æˆ·å·²ç™»å½•ï¼Œå¯ä»¥è·å–ç”¨æˆ·ä¿¡æ¯
    String username = loginUser.getUsername();
    String userRole = loginUser.getRole();
    // ... å…¶ä»–æ“ä½œ
} else {
    // ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µé¢
    response.sendRedirect("login.jsp");
}
```

### 3.3 Sessionå­˜å‚¨çš„æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š
```
ğŸ”¸ å­˜å‚¨å¿…è¦ä¿¡æ¯ï¼šç”¨æˆ·IDã€ç”¨æˆ·åã€è§’è‰²ç­‰å…³é”®ä¿¡æ¯
ğŸ”¸ è®¾ç½®è¶…æ—¶æ—¶é—´ï¼šé˜²æ­¢Sessioné•¿æ—¶é—´å ç”¨å†…å­˜
ğŸ”¸ åŠæ—¶æ¸…ç†ï¼šç”¨æˆ·é€€å‡ºæ—¶ä¸»åŠ¨é”€æ¯Session
ğŸ”¸ å®‰å…¨è€ƒè™‘ï¼šæ•æ„Ÿä¿¡æ¯ä¸è¦ç›´æ¥å­˜åœ¨Sessionä¸­
```

**âŒ é¿å…åšæ³•**ï¼š
```
ğŸ”¸ å­˜å‚¨è¿‡å¤šæ•°æ®ï¼šä¼šå ç”¨å¤§é‡æœåŠ¡å™¨å†…å­˜
ğŸ”¸ å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼šå¯†ç ã€é“¶è¡Œå¡å·ç­‰ä¸è¦å­˜Session
ğŸ”¸ æ°¸ä¸è¿‡æœŸï¼šä¼šé€ æˆå†…å­˜æ³„æ¼
ğŸ”¸ æ˜æ–‡å­˜å‚¨ï¼šé‡è¦ä¿¡æ¯åº”è¯¥åŠ å¯†å­˜å‚¨
```

---

## 4. ğŸ¯ ç™»å½•çŠ¶æ€åˆ¤æ–­æœºåˆ¶


### 4.1 ç™»å½•çŠ¶æ€åˆ¤æ–­çš„åŸºæœ¬åŸç†


**ç®€å•ç†è§£**ï¼šå°±åƒæ£€æŸ¥ä½ æ˜¯å¦å¸¦äº†é—¨ç¦å¡

```
å°åŒºé—¨ç¦æ£€æŸ¥ï¼š
è¿›å…¥å°åŒºæ—¶ â†’ æ£€æŸ¥æ˜¯å¦æœ‰é—¨ç¦å¡ â†’ æœ‰å¡æ”¾è¡Œï¼Œæ— å¡æ‹’ç»

ç½‘ç«™ç™»å½•æ£€æŸ¥ï¼š
è®¿é—®é¡µé¢æ—¶ â†’ æ£€æŸ¥Sessionä¸­æ˜¯å¦æœ‰ç”¨æˆ·ä¿¡æ¯ â†’ æœ‰åˆ™ç»§ç»­ï¼Œæ— åˆ™è·³è½¬ç™»å½•
```

### 4.2 ä¸‰ç§å¸¸è§çš„åˆ¤æ–­æ–¹å¼


**ğŸŸ¢ æ–¹å¼ä¸€ï¼šåœ¨æ¯ä¸ªServletä¸­å•ç‹¬åˆ¤æ–­**
```java
// åœ¨éœ€è¦ç™»å½•çš„Servletä¸­æ·»åŠ æ£€æŸ¥
public class UserInfoServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) {
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        HttpSession session = request.getSession();
        User loginUser = (User) session.getAttribute("loginUser");
        
        if (loginUser == null) {
            // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µé¢
            response.sendRedirect("login.jsp");
            return;
        }
        
        // å·²ç™»å½•ï¼Œç»§ç»­å¤„ç†ä¸šåŠ¡é€»è¾‘
        // ... 
    }
}
```

**ğŸŸ¡ æ–¹å¼äºŒï¼šä½¿ç”¨è¿‡æ»¤å™¨Filterï¼ˆæ¨èï¼‰**
```java
// LoginCheckFilter.java - ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨
public class LoginCheckFilter implements Filter {
    
    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) {
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) resp;
        
        // è·å–å½“å‰è®¿é—®çš„è·¯å¾„
        String uri = request.getRequestURI();
        
        // æ’é™¤ä¸éœ€è¦ç™»å½•çš„é¡µé¢
        if (uri.contains("login") || uri.contains("register") || 
            uri.contains(".css") || uri.contains(".js")) {
            // ç›´æ¥æ”¾è¡Œ
            chain.doFilter(request, response);
            return;
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        HttpSession session = request.getSession();
        User loginUser = (User) session.getAttribute("loginUser");
        
        if (loginUser != null) {
            // å·²ç™»å½•ï¼Œç»§ç»­è®¿é—®
            chain.doFilter(request, response);
        } else {
            // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µé¢
            response.sendRedirect(request.getContextPath() + "/login.jsp");
        }
    }
}
```

**ğŸ”µ æ–¹å¼ä¸‰ï¼šåœ¨JSPé¡µé¢ä¸­åˆ¤æ–­**
```jsp
<%-- åœ¨JSPé¡µé¢é¡¶éƒ¨æ·»åŠ ç™»å½•æ£€æŸ¥ --%>
<%
    User loginUser = (User) session.getAttribute("loginUser");
    if (loginUser == null) {
        response.sendRedirect("login.jsp");
        return;
    }
%>

<html>
<head><title>ç”¨æˆ·ä¸­å¿ƒ</title></head>
<body>
    <h1>æ¬¢è¿ï¼Œ${loginUser.username}ï¼</h1>
    <!-- é¡µé¢å†…å®¹ -->
</body>
</html>
```

### 4.3 ç™»å½•çŠ¶æ€åˆ¤æ–­çš„ä¼˜åŒ–


**é¡µé¢æƒé™æ§åˆ¶è¡¨**ï¼š

| é¡µé¢ç±»å‹ | **æ˜¯å¦éœ€è¦ç™»å½•** | **å¤„ç†æ–¹å¼** |
|---------|----------------|-------------|
| `ç™»å½•é¡µé¢` | `âŒ ä¸éœ€è¦` | `ç›´æ¥è®¿é—®` |
| `æ³¨å†Œé¡µé¢` | `âŒ ä¸éœ€è¦` | `ç›´æ¥è®¿é—®` |
| `é¦–é¡µ` | `âŒ ä¸éœ€è¦` | `æ˜¾ç¤ºä¸åŒå†…å®¹` |
| `ä¸ªäººä¸­å¿ƒ` | `âœ… éœ€è¦` | `æœªç™»å½•è·³è½¬ç™»å½•é¡µ` |
| `è®¢å•é¡µé¢` | `âœ… éœ€è¦` | `æœªç™»å½•è·³è½¬ç™»å½•é¡µ` |
| `ç®¡ç†åå°` | `âœ… éœ€è¦` | `æ£€æŸ¥ç”¨æˆ·è§’è‰²æƒé™` |

---

## 5. ğŸ”„ è‡ªåŠ¨ç™»å½•å®ç°åŸç†


### 5.1 è‡ªåŠ¨ç™»å½•çš„åŸºæœ¬æ¦‚å¿µ


**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šå°±åƒæ‰‹æœºçš„æŒ‡çº¹è§£é”

```
æŒ‡çº¹è§£é”åŸç†ï¼š
1. ç¬¬ä¸€æ¬¡è®¾ç½®æ—¶å½•å…¥æŒ‡çº¹ï¼ˆç›¸å½“äºé¦–æ¬¡ç™»å½•ï¼‰
2. æ‰‹æœºä¿å­˜æŒ‡çº¹ä¿¡æ¯ï¼ˆç›¸å½“äºä¿å­˜ç™»å½•å‡­è¯ï¼‰
3. ä¸‹æ¬¡å¼€æœºæ—¶è¯†åˆ«æŒ‡çº¹ï¼ˆç›¸å½“äºè‡ªåŠ¨ç™»å½•éªŒè¯ï¼‰
4. è¯†åˆ«æˆåŠŸç›´æ¥è§£é”ï¼ˆç›¸å½“äºå…è¾“å¯†ç ç™»å½•ï¼‰

è‡ªåŠ¨ç™»å½•åŸç†ï¼š
1. ç”¨æˆ·é¦–æ¬¡ç™»å½•æ—¶å‹¾é€‰"è®°ä½æˆ‘"
2. æœåŠ¡å™¨ç”Ÿæˆå”¯ä¸€çš„è®°ä½ä»¤ç‰Œä¿å­˜åˆ°Cookie
3. ä¸‹æ¬¡è®¿é—®æ—¶æ£€æŸ¥Cookieä¸­çš„ä»¤ç‰Œ
4. ä»¤ç‰Œæœ‰æ•ˆåˆ™è‡ªåŠ¨åˆ›å»ºSessionå®Œæˆç™»å½•
```

### 5.2 è‡ªåŠ¨ç™»å½•çš„å®ç°æ­¥éª¤


**ğŸŸ¢ åŸºç¡€ç‰ˆæœ¬** - Cookie + Tokenæ–¹å¼ï¼š

```java
// ç™»å½•æ—¶å¤„ç†"è®°ä½æˆ‘"åŠŸèƒ½
if ("true".equals(rememberMe)) {
    // ç”Ÿæˆå”¯ä¸€çš„è®°ä½ä»¤ç‰Œ
    String rememberToken = UUID.randomUUID().toString();
    
    // å°†ä»¤ç‰Œä¿å­˜åˆ°æ•°æ®åº“ï¼Œå…³è”ç”¨æˆ·ID
    userService.saveRememberToken(user.getId(), rememberToken);
    
    // å°†ä»¤ç‰Œä¿å­˜åˆ°Cookieï¼ˆæœ‰æ•ˆæœŸ7å¤©ï¼‰
    Cookie rememberCookie = new Cookie("rememberToken", rememberToken);
    rememberCookie.setMaxAge(7 * 24 * 60 * 60); // 7å¤©
    rememberCookie.setPath("/");
    response.addCookie(rememberCookie);
}
```

**è‡ªåŠ¨ç™»å½•æ£€æŸ¥é€»è¾‘**ï¼š
```java
// åœ¨ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨ä¸­æ·»åŠ è‡ªåŠ¨ç™»å½•é€»è¾‘
public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) {
    // ... å‰é¢çš„ä»£ç 
    
    // å¦‚æœSessionä¸­æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œæ£€æŸ¥è‡ªåŠ¨ç™»å½•
    if (loginUser == null) {
        // æ£€æŸ¥Cookieä¸­çš„è®°ä½ä»¤ç‰Œ
        String rememberToken = getCookieValue(request, "rememberToken");
        
        if (rememberToken != null) {
            // æ ¹æ®ä»¤ç‰ŒæŸ¥æ‰¾ç”¨æˆ·
            User user = userService.getUserByRememberToken(rememberToken);
            
            if (user != null) {
                // è‡ªåŠ¨ç™»å½•æˆåŠŸï¼Œåˆ›å»ºSession
                HttpSession session = request.getSession();
                session.setAttribute("loginUser", user);
                
                // ç»§ç»­è®¿é—®
                chain.doFilter(request, response);
                return;
            }
        }
        
        // è‡ªåŠ¨ç™»å½•å¤±è´¥ï¼Œè·³è½¬ç™»å½•é¡µé¢
        response.sendRedirect("login.jsp");
        return;
    }
    
    // å·²ç™»å½•ï¼Œç»§ç»­è®¿é—®
    chain.doFilter(request, response);
}
```

### 5.3 è‡ªåŠ¨ç™»å½•çš„å®‰å…¨è€ƒè™‘


**ğŸ”’ å®‰å…¨æªæ–½**ï¼š

| å®‰å…¨é—®é¢˜ | **è§£å†³æ–¹æ¡ˆ** | **è¯´æ˜** |
|---------|------------|---------|
| `ä»¤ç‰Œè¢«ç›—ç”¨` | `å®šæœŸæ›´æ¢ä»¤ç‰Œ` | `æ¯æ¬¡è‡ªåŠ¨ç™»å½•åç”Ÿæˆæ–°ä»¤ç‰Œ` |
| `ä»¤ç‰Œæ°¸ä¸è¿‡æœŸ` | `è®¾ç½®è¿‡æœŸæ—¶é—´` | `é€šå¸¸7-30å¤©` |
| `å¤šè®¾å¤‡å†²çª` | `ä¸€ç”¨æˆ·ä¸€ä»¤ç‰Œ` | `æ–°è®¾å¤‡ç™»å½•æ—¶æ¸…é™¤æ—§ä»¤ç‰Œ` |
| `ä»¤ç‰Œæ³„éœ²é£é™©` | `HTTPSä¼ è¾“` | `åŠ å¯†ä¼ è¾“é˜²æ­¢çªƒå¬` |

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- è‡ªåŠ¨ç™»å½•åªé€‚ç”¨äºä¸ªäººè®¾å¤‡
- å…¬å…±ç”µè„‘ä¸å»ºè®®ä½¿ç”¨è‡ªåŠ¨ç™»å½•
- é‡è¦æ“ä½œä»éœ€è¦é‡æ–°éªŒè¯å¯†ç 

---

## 6. ğŸšª å®‰å…¨é€€å‡ºå¤„ç†


### 6.1 é€€å‡ºç™»å½•çš„åŸºæœ¬åŸç†


**ç°å®æ¯”å–»**ï¼šå°±åƒé…’åº—é€€æˆ¿ä¸€æ ·

```
é…’åº—é€€æˆ¿æµç¨‹ï¼š
1. ä½ åˆ°å‰å°è¯´è¦é€€æˆ¿
2. å‰å°æ”¶å›æˆ¿å¡
3. æ¸…ç†æˆ¿é—´ä¿¡æ¯
4. ä½ ä¸èƒ½å†ä½¿ç”¨é…’åº—è®¾æ–½

ç½‘ç«™é€€å‡ºç™»å½•ï¼š
1. ç”¨æˆ·ç‚¹å‡»é€€å‡ºæŒ‰é’®
2. æœåŠ¡å™¨é”€æ¯Session
3. æ¸…é™¤Cookieä¿¡æ¯
4. è·³è½¬åˆ°ç™»å½•é¡µé¢
```

### 6.2 å®Œæ•´çš„é€€å‡ºå¤„ç†æµç¨‹


```java
// LogoutServlet.java - å¤„ç†é€€å‡ºç™»å½•
protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    // 1. è·å–å½“å‰Session
    HttpSession session = request.getSession(false);
    
    if (session != null) {
        // 2. è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨äºæ¸…ç†è®°ä½ä»¤ç‰Œï¼‰
        User loginUser = (User) session.getAttribute("loginUser");
        
        if (loginUser != null) {
            // 3. æ¸…ç†æ•°æ®åº“ä¸­çš„è®°ä½ä»¤ç‰Œ
            userService.clearRememberToken(loginUser.getId());
        }
        
        // 4. é”€æ¯Session
        session.invalidate();
    }
    
    // 5. æ¸…é™¤å®¢æˆ·ç«¯Cookie
    Cookie rememberCookie = new Cookie("rememberToken", "");
    rememberCookie.setMaxAge(0); // ç«‹å³è¿‡æœŸ
    rememberCookie.setPath("/");
    response.addCookie(rememberCookie);
    
    // 6. è·³è½¬åˆ°ç™»å½•é¡µé¢
    response.sendRedirect("login.jsp");
}
```

### 6.3 é€€å‡ºç™»å½•çš„æ³¨æ„äº‹é¡¹


**âœ… å®Œæ•´çš„é€€å‡ºå¤„ç†åº”è¯¥åŒ…æ‹¬**ï¼š
```
ğŸ”¸ é”€æ¯Sessionï¼šsession.invalidate()
ğŸ”¸ æ¸…é™¤Cookieï¼šå°†è®°ä½ä»¤ç‰ŒCookieè®¾ä¸ºè¿‡æœŸ
ğŸ”¸ æ¸…ç†æ•°æ®åº“ï¼šåˆ é™¤è®°ä½ä»¤ç‰Œè®°å½•
ğŸ”¸ é¡µé¢è·³è½¬ï¼šè·³è½¬åˆ°ç™»å½•é¡µé¢æˆ–é¦–é¡µ
ğŸ”¸ æ—¥å¿—è®°å½•ï¼šè®°å½•ç”¨æˆ·é€€å‡ºæ—¥å¿—ï¼ˆå¯é€‰ï¼‰
```

**âŒ ä¸å®Œæ•´çš„é€€å‡ºå¤„ç†é—®é¢˜**ï¼š
```
ğŸ”¸ åªæ¸…Sessionä¸æ¸…Cookieï¼šå¯èƒ½è¢«è‡ªåŠ¨ç™»å½•
ğŸ”¸ åªæ¸…å‰ç«¯ä¸æ¸…åç«¯ï¼šå®‰å…¨éšæ‚£
ğŸ”¸ ä¸æ¸…ç†æ•°æ®åº“è®°å½•ï¼šå ç”¨å­˜å‚¨ç©ºé—´
ğŸ”¸ ä¸åšé¡µé¢è·³è½¬ï¼šç”¨æˆ·ä½“éªŒå·®
```

---

## 7. ğŸ¯ å®Œæ•´ç™»å½•ç³»ç»Ÿæ¡ˆä¾‹


### 7.1 é¡¹ç›®ç»“æ„ä¸€è§ˆ


```
LoginSystem/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ servlet/
â”‚   â”‚   â”œâ”€â”€ LoginServlet.java      â† å¤„ç†ç™»å½•
â”‚   â”‚   â”œâ”€â”€ LogoutServlet.java     â† å¤„ç†é€€å‡º
â”‚   â”‚   â””â”€â”€ UserInfoServlet.java   â† ç”¨æˆ·ä¿¡æ¯é¡µé¢
â”‚   â”œâ”€â”€ filter/
â”‚   â”‚   â””â”€â”€ LoginCheckFilter.java  â† ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â””â”€â”€ UserService.java       â† ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â””â”€â”€ entity/
â”‚       â””â”€â”€ User.java              â† ç”¨æˆ·å®ä½“ç±»
â””â”€â”€ webapp/
    â”œâ”€â”€ login.jsp                  â† ç™»å½•é¡µé¢
    â”œâ”€â”€ index.jsp                  â† é¦–é¡µ
    â”œâ”€â”€ userInfo.jsp               â† ç”¨æˆ·ä¿¡æ¯é¡µé¢
    â””â”€â”€ WEB-INF/
        â””â”€â”€ web.xml                â† é…ç½®æ–‡ä»¶
```

### 7.2 æ ¸å¿ƒä»£ç å®ç°


**ç™»å½•é¡µé¢ - login.jsp**ï¼š
```jsp
<%@ page contentType="text/html;charset=UTF-8" %>
<html>
<head>
    <title>ç”¨æˆ·ç™»å½•</title>
    <style>
        .login-form { width: 300px; margin: 100px auto; }
        .form-group { margin: 15px 0; }
        .form-control { width: 100%; padding: 8px; }
        .btn { padding: 10px 20px; background: #007bff; color: white; border: none; }
        .error { color: red; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="login-form">
        <h2>ç”¨æˆ·ç™»å½•</h2>
        
        <%-- æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ --%>
        <% String errorMsg = (String) request.getAttribute("errorMsg"); %>
        <% if (errorMsg != null) { %>
            <div class="error"><%=errorMsg%></div>
        <% } %>
        
        <form action="login" method="post">
            <div class="form-group">
                <input type="text" name="username" placeholder="ç”¨æˆ·å" 
                       class="form-control" required>
            </div>
            <div class="form-group">
                <input type="password" name="password" placeholder="å¯†ç " 
                       class="form-control" required>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" name="rememberMe" value="true"> è®°ä½æˆ‘
                </label>
            </div>
            <div class="form-group">
                <button type="submit" class="btn">ç™»å½•</button>
            </div>
        </form>
    </div>
</body>
</html>
```

**ç”¨æˆ·ä¿¡æ¯é¡µé¢ - userInfo.jsp**ï¼š
```jsp
<%@ page contentType="text/html;charset=UTF-8" %>
<%@ page import="entity.User" %>
<html>
<head>
    <title>ç”¨æˆ·ä¸­å¿ƒ</title>
</head>
<body>
    <h1>ç”¨æˆ·ä¸­å¿ƒ</h1>
    
    <%-- æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ --%>
    <% User loginUser = (User) session.getAttribute("loginUser"); %>
    <p>æ¬¢è¿ï¼Œ<%=loginUser.getUsername()%>ï¼</p>
    <p>ç”¨æˆ·IDï¼š<%=loginUser.getId()%></p>
    <p>æœ€åç™»å½•ï¼š<%=loginUser.getLastLoginTime()%></p>
    
    <a href="logout">å®‰å…¨é€€å‡º</a>
</body>
</html>
```

### 7.3 é…ç½®æ–‡ä»¶è®¾ç½®


**web.xml é…ç½®**ï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://java.sun.com/xml/ns/javaee" version="3.0">
    
    <!-- ç™»å½•Servlet -->
    <servlet>
        <servlet-name>LoginServlet</servlet-name>
        <servlet-class>servlet.LoginServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>LoginServlet</servlet-name>
        <url-pattern>/login</url-pattern>
    </servlet-mapping>
    
    <!-- é€€å‡ºServlet -->
    <servlet>
        <servlet-name>LogoutServlet</servlet-name>
        <servlet-class>servlet.LogoutServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>LogoutServlet</servlet-name>
        <url-pattern>/logout</url-pattern>
    </servlet-mapping>
    
    <!-- ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>LoginCheckFilter</filter-name>
        <filter-class>filter.LoginCheckFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>LoginCheckFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
    
    <!-- Sessionè¶…æ—¶è®¾ç½®ï¼ˆ30åˆ†é’Ÿï¼‰ -->
    <session-config>
        <session-timeout>30</session-timeout>
    </session-config>
    
</web-app>
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç™»å½•éªŒè¯ï¼šå°±åƒé“¶è¡Œæ ¸å®èº«ä»½è¯ï¼ŒéªŒè¯ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
ğŸ”¸ Sessionå­˜å‚¨ï¼šå°±åƒé…’åº—æˆ¿å¡ï¼Œä¿å­˜ç”¨æˆ·ç™»å½•çŠ¶æ€ä¿¡æ¯
ğŸ”¸ çŠ¶æ€åˆ¤æ–­ï¼šå°±åƒé—¨ç¦æ£€æŸ¥ï¼Œç¡®è®¤ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•
ğŸ”¸ è‡ªåŠ¨ç™»å½•ï¼šå°±åƒæŒ‡çº¹è§£é”ï¼Œé€šè¿‡Cookieä»¤ç‰Œå…å¯†ç ç™»å½•
ğŸ”¸ å®‰å…¨é€€å‡ºï¼šå°±åƒé…’åº—é€€æˆ¿ï¼Œæ¸…ç†æ‰€æœ‰ç™»å½•ç›¸å…³ä¿¡æ¯
```

### 8.2 å…³é”®å®ç°è¦ç‚¹


**ğŸ”¹ ç™»å½•éªŒè¯æµç¨‹**ï¼š
```
ç”¨æˆ·è¾“å…¥ â†’ å‚æ•°è·å– â†’ æ•°æ®åº“æŸ¥è¯¢ â†’ å¯†ç æ¯”å¯¹ â†’ ç»“æœå¤„ç†
```

**ğŸ”¹ Sessionä½¿ç”¨åŸåˆ™**ï¼š
```
ç™»å½•æˆåŠŸï¼šsession.setAttribute("loginUser", user)
çŠ¶æ€æ£€æŸ¥ï¼š(User) session.getAttribute("loginUser")
å®‰å…¨é€€å‡ºï¼šsession.invalidate()
```

**ğŸ”¹ è‡ªåŠ¨ç™»å½•æœºåˆ¶**ï¼š
```
ç”Ÿæˆä»¤ç‰Œ â†’ ä¿å­˜Cookie â†’ æ•°æ®åº“å­˜å‚¨ â†’ ä¸‹æ¬¡éªŒè¯ â†’ è‡ªåŠ¨ç™»å½•
```

### 8.3 æœ€ä½³å®è·µå»ºè®®


**âœ… å®‰å…¨æ€§è€ƒè™‘**ï¼š
- å¯†ç è¦åŠ å¯†å­˜å‚¨ï¼ˆMD5/SHA256ï¼‰
- ä½¿ç”¨HTTPSä¼ è¾“æ•æ„Ÿä¿¡æ¯
- è®¾ç½®åˆç†çš„Sessionè¶…æ—¶æ—¶é—´
- è®°ä½ä»¤ç‰Œè¦å®šæœŸæ›´æ¢

**âœ… ç”¨æˆ·ä½“éªŒä¼˜åŒ–**ï¼š
- ç™»å½•å¤±è´¥è¦æœ‰æ˜ç¡®çš„é”™è¯¯æç¤º
- æ”¯æŒè‡ªåŠ¨ç™»å½•åŠŸèƒ½
- é€€å‡ºç™»å½•è¦å½»åº•æ¸…ç†çŠ¶æ€
- é¡µé¢è·³è½¬è¦æµç•…è‡ªç„¶

**âœ… ä»£ç ç»„ç»‡å»ºè®®**ï¼š
- ä½¿ç”¨Filterç»Ÿä¸€å¤„ç†ç™»å½•æ£€æŸ¥
- ä¸šåŠ¡é€»è¾‘æ”¾åœ¨Serviceå±‚
- æ•æ„Ÿæ“ä½œè¦æœ‰æ—¥å¿—è®°å½•
- å¼‚å¸¸æƒ…å†µè¦æœ‰å®¹é”™å¤„ç†

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç™»å½•ç³»ç»Ÿå°±æ˜¯ç½‘ç«™çš„é—¨ç¦ï¼ŒéªŒè¯èº«ä»½ã€è®°å½•çŠ¶æ€ã€æ§åˆ¶æƒé™
- Sessionåƒæˆ¿å¡ï¼ŒCookieåƒæŒ‡çº¹ï¼Œéƒ½æ˜¯ä¿æŒç™»å½•çŠ¶æ€çš„æ–¹å¼
- å®‰å…¨é€€å‡ºè¦æ¸…ç†Sessionã€Cookieã€æ•°æ®åº“ä»¤ç‰Œï¼Œä¸€ä¸ªéƒ½ä¸èƒ½å°‘
- è¿‡æ»¤å™¨æ˜¯æœ€å¥½çš„ç»Ÿä¸€ç™»å½•æ£€æŸ¥æ–¹æ¡ˆï¼Œé¿å…åœ¨æ¯ä¸ªé¡µé¢é‡å¤ç¼–ç 