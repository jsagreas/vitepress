---
title: 1ã€å¾®æœåŠ¡æ¶æ„ä¸‹çš„ä¼šè¯
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡ä¼šè¯ç®¡ç†æ¦‚è¿°](#1-å¾®æœåŠ¡ä¼šè¯ç®¡ç†æ¦‚è¿°)
2. [ä¼ ç»Ÿæ¶æ„vså¾®æœåŠ¡æ¶æ„çš„ä¼šè¯å·®å¼‚](#2-ä¼ ç»Ÿæ¶æ„vså¾®æœåŠ¡æ¶æ„çš„ä¼šè¯å·®å¼‚)
3. [å¾®æœåŠ¡ä¼šè¯ç®¡ç†çš„æ ¸å¿ƒæŒ‘æˆ˜](#3-å¾®æœåŠ¡ä¼šè¯ç®¡ç†çš„æ ¸å¿ƒæŒ‘æˆ˜)
4. [æœåŠ¡é—´è®¤è¯æœºåˆ¶](#4-æœåŠ¡é—´è®¤è¯æœºåˆ¶)
5. [Gatewayç½‘å…³è®¤è¯](#5-Gatewayç½‘å…³è®¤è¯)
6. [ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ(SSO)](#6-ç»Ÿä¸€è®¤è¯ä¸­å¿ƒSSO)
7. [æœåŠ¡è°ƒç”¨é‰´æƒç­–ç•¥](#7-æœåŠ¡è°ƒç”¨é‰´æƒç­–ç•¥)
8. [å¾®æœåŠ¡ä¼šè¯å®æˆ˜æ¡ˆä¾‹](#8-å¾®æœåŠ¡ä¼šè¯å®æˆ˜æ¡ˆä¾‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å¾®æœåŠ¡ä¼šè¯ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ä¸‹çš„ä¼šè¯ç®¡ç†


**ç®€å•ç†è§£**ï¼šæƒ³è±¡ä¸€ä¸ªå¤§å•†åœºè¢«æ‹†åˆ†æˆå¾ˆå¤šä¸ªå°åº—é“ºï¼Œæ¯ä¸ªåº—é“ºéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä½†é¡¾å®¢éœ€è¦åœ¨æ•´ä¸ªå•†åœºå†…è‡ªç”±è´­ç‰©ï¼Œä¼šè¯ç®¡ç†å°±æ˜¯ç¡®ä¿é¡¾å®¢çš„èº«ä»½åœ¨æ‰€æœ‰åº—é“ºéƒ½èƒ½è¢«è®¤å¯ã€‚

```
ä¼ ç»Ÿå•ä½“åº”ç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸€ä¸ªå¤§åº”ç”¨           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ç”¨æˆ·â”‚ â”‚å•†å“â”‚ â”‚è®¢å•â”‚   â”‚  â† ä¸€ä¸ªSessionç®¡æ‰€æœ‰
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¾®æœåŠ¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”
â”‚ç”¨æˆ·â”‚    â”‚å•†å“â”‚    â”‚è®¢å•â”‚  â† æ¯ä¸ªæœåŠ¡éƒ½ç‹¬ç«‹
â”‚æœåŠ¡â”‚    â”‚æœåŠ¡â”‚    â”‚æœåŠ¡â”‚
â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜
   â†•         â†•         â†•
éœ€è¦ç»Ÿä¸€çš„èº«ä»½è®¤è¯å’Œæƒé™ç®¡ç†
```

> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> å¾®æœåŠ¡ä¼šè¯ç®¡ç†å°±æ˜¯åœ¨å¤šä¸ªç‹¬ç«‹æœåŠ¡ä¹‹é—´ï¼Œä¿æŒç”¨æˆ·èº«ä»½çš„ä¸€è‡´æ€§å’Œå®‰å…¨æ€§

### 1.2 ä¸ºä»€ä¹ˆå¾®æœåŠ¡éœ€è¦ç‰¹æ®Šçš„ä¼šè¯ç®¡ç†


**ä¸»è¦åŸå› **ï¼š
- **æœåŠ¡åˆ†ç¦»**ï¼šæ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„åº”ç”¨ï¼Œæœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´
- **ç½‘ç»œé€šä¿¡**ï¼šæœåŠ¡é—´é€šè¿‡ç½‘ç»œè°ƒç”¨ï¼Œä¸èƒ½ç›´æ¥å…±äº«Session
- **å®‰å…¨éš”ç¦»**ï¼šæ¯ä¸ªæœåŠ¡éœ€è¦éªŒè¯è°ƒç”¨è€…çš„èº«ä»½
- **æ‰©å±•å¤æ‚**ï¼šæœåŠ¡å¯èƒ½éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š

---

## 2. âš–ï¸ ä¼ ç»Ÿæ¶æ„vså¾®æœåŠ¡æ¶æ„çš„ä¼šè¯å·®å¼‚


### 2.1 ä¼ ç»Ÿå•ä½“æ¶æ„çš„ä¼šè¯ç®¡ç†


**å·¥ä½œæ–¹å¼**ï¼š
```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
æµè§ˆå™¨ â†’ è´Ÿè½½å‡è¡¡ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ æ•°æ®åº“
         â†“
      Sessionå­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­
      æ‰€æœ‰åŠŸèƒ½æ¨¡å—å…±äº«åŒä¸€ä¸ªSession
```

**ç‰¹ç‚¹**ï¼š
- âœ… **ç®€å•ç›´æ¥**ï¼šä¸€ä¸ªSessionç®¡ç†æ‰€æœ‰åŠŸèƒ½
- âœ… **æ€§èƒ½å¥½**ï¼šå†…å­˜è®¿é—®é€Ÿåº¦å¿«
- âŒ **æ‰©å±•æ€§å·®**ï¼šæœåŠ¡å™¨é‡å¯Sessionä¸¢å¤±
- âŒ **è€¦åˆåº¦é«˜**ï¼šæ‰€æœ‰åŠŸèƒ½ç»‘å®šåœ¨ä¸€èµ·

### 2.2 å¾®æœåŠ¡æ¶æ„çš„ä¼šè¯æŒ‘æˆ˜


```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
æµè§ˆå™¨ â†’ APIç½‘å…³ â†’ ç”¨æˆ·æœåŠ¡ â†’ å•†å“æœåŠ¡ â†’ è®¢å•æœåŠ¡
                    â†“         â†“         â†“
                æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦éªŒè¯ç”¨æˆ·èº«ä»½
                ä½†å®ƒä»¬ç›¸äº’ç‹¬ç«‹ï¼Œæ— æ³•å…±äº«Session
```

| å¯¹æ¯”ç»´åº¦ | **ä¼ ç»Ÿæ¶æ„** | **å¾®æœåŠ¡æ¶æ„** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|---------------|-------------|
| Sessionå…±äº« | âœ… å¤©ç„¶å…±äº« | âŒ æ— æ³•ç›´æ¥å…±äº« | å¤–éƒ¨å­˜å‚¨(Redis) |
| èº«ä»½éªŒè¯ | âœ… ä¸€æ¬¡éªŒè¯ | âŒ æ¯ä¸ªæœåŠ¡éƒ½éœ€éªŒè¯ | JWT Token |
| æœåŠ¡è°ƒç”¨ | âœ… å†…éƒ¨è°ƒç”¨ | âŒ ç½‘ç»œè°ƒç”¨éœ€é‰´æƒ | æœåŠ¡é—´è®¤è¯ |
| æ‰©å±•æ€§ | âŒ å‚ç›´æ‰©å±• | âœ… æ°´å¹³æ‰©å±• | æ— çŠ¶æ€è®¾è®¡ |

---

## 3. ğŸš¨ å¾®æœåŠ¡ä¼šè¯ç®¡ç†çš„æ ¸å¿ƒæŒ‘æˆ˜


### 3.1 æŒ‘æˆ˜ä¸€ï¼šSessionå…±äº«é—®é¢˜


**é—®é¢˜æè¿°**ï¼šç”¨æˆ·åœ¨ç”¨æˆ·æœåŠ¡ç™»å½•åï¼Œè®¿é—®è®¢å•æœåŠ¡æ—¶æ— æ³•è¯†åˆ«èº«ä»½

```
é—®é¢˜åœºæ™¯ï¼š
1. ç”¨æˆ·åœ¨ç”¨æˆ·æœåŠ¡(8080ç«¯å£)ç™»å½• âœ…
2. Sessionå­˜å‚¨åœ¨ç”¨æˆ·æœåŠ¡å†…å­˜ä¸­
3. ç”¨æˆ·è®¿é—®è®¢å•æœåŠ¡(8081ç«¯å£) âŒ
4. è®¢å•æœåŠ¡æ— æ³•è®¿é—®ç”¨æˆ·æœåŠ¡çš„å†…å­˜
5. ç»“æœï¼šç”¨æˆ·è¢«è¦æ±‚é‡æ–°ç™»å½•
```

**ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„å±€é™**ï¼š
- **Sessionå¤åˆ¶**ï¼šæœåŠ¡å¤ªå¤šæ—¶å¤åˆ¶å¼€é”€å·¨å¤§
- **ç²˜æ€§ä¼šè¯**ï¼šè´Ÿè½½å‡è¡¡å›ºå®šç”¨æˆ·åˆ°ç‰¹å®šæœåŠ¡å™¨ï¼Œå¤±å»å¾®æœåŠ¡ä¼˜åŠ¿

### 3.2 æŒ‘æˆ˜äºŒï¼šæœåŠ¡é—´è®¤è¯é—®é¢˜


**é—®é¢˜æè¿°**ï¼šä¸€ä¸ªæœåŠ¡å¦‚ä½•è¯æ˜å®ƒæœ‰æƒé™è°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡

```
æœåŠ¡è°ƒç”¨åœºæ™¯ï¼š
è®¢å•æœåŠ¡éœ€è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     è°ƒç”¨API     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚è®¢å•æœåŠ¡â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ç”¨æˆ·æœåŠ¡â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šç”¨æˆ·æœåŠ¡æ€ä¹ˆçŸ¥é“è¿™ä¸ªè°ƒç”¨æ˜¯åˆæ³•çš„ï¼Ÿ
```

**å®‰å…¨é£é™©**ï¼š
- **ä¼ªé€ è°ƒç”¨**ï¼šæ¶æ„æœåŠ¡å†’å……åˆæ³•æœåŠ¡
- **æƒé™æ»¥ç”¨**ï¼šæœåŠ¡è°ƒç”¨è¶…å‡ºå…¶æƒé™èŒƒå›´çš„API
- **æ•°æ®æ³„éœ²**ï¼šæœªç»æˆæƒè®¿é—®æ•æ„Ÿæ•°æ®

### 3.3 æŒ‘æˆ˜ä¸‰ï¼šåˆ†å¸ƒå¼ä¼šè¯çŠ¶æ€ç®¡ç†


**é—®é¢˜æè¿°**ï¼šç”¨æˆ·çŠ¶æ€ä¿¡æ¯æ•£å¸ƒåœ¨å¤šä¸ªæœåŠ¡ä¸­ï¼Œå¦‚ä½•ä¿æŒä¸€è‡´æ€§

```
ç”¨æˆ·çŠ¶æ€åˆ†å¸ƒï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç”¨æˆ·æœåŠ¡â”‚    â”‚å•†å“æœåŠ¡â”‚    â”‚è®¢å•æœåŠ¡â”‚
â”‚ç”¨æˆ·ä¿¡æ¯â”‚    â”‚è´­ç‰©è½¦  â”‚    â”‚è®¢å•å†å²â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
- ç”¨æˆ·åœ¨AæœåŠ¡ä¿®æ”¹äº†ä¿¡æ¯ï¼ŒBæœåŠ¡å¦‚ä½•æ„ŸçŸ¥ï¼Ÿ
- ç”¨æˆ·ç™»å‡ºæ—¶ï¼Œå¦‚ä½•é€šçŸ¥æ‰€æœ‰ç›¸å…³æœåŠ¡ï¼Ÿ
```

---

## 4. ğŸ” æœåŠ¡é—´è®¤è¯æœºåˆ¶


### 4.1 JWT Tokenè®¤è¯


**JWTæ˜¯ä»€ä¹ˆ**ï¼šJSON Web Tokenï¼Œå°±åƒä¸€ä¸ªæ•°å­—èº«ä»½è¯ï¼ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œç­¾å

```
JWTç»“æ„è§£æï¼š
xxxxx.yyyyy.zzzzz
  â†“     â†“     â†“
Header.Payload.Signature

Header(å¤´éƒ¨): è¯´æ˜Tokenç±»å‹å’Œç®—æ³•
Payload(è½½è·): åŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
Signature(ç­¾å): é˜²æ­¢Tokenè¢«ç¯¡æ”¹
```

**JWTè®¤è¯æµç¨‹**ï¼š
```
1. ç”¨æˆ·ç™»å½•
   æµè§ˆå™¨ â†’ è®¤è¯æœåŠ¡ â†’ éªŒè¯æˆåŠŸ â†’ ç”ŸæˆJWT

2. æœåŠ¡é—´è°ƒç”¨
   æœåŠ¡A â†’ æºå¸¦JWT â†’ æœåŠ¡B â†’ éªŒè¯JWT â†’ è¿”å›æ•°æ®

3. JWTéªŒè¯è¿‡ç¨‹
   æœåŠ¡Bæ¥æ”¶JWT â†’ éªŒè¯ç­¾å â†’ æå–ç”¨æˆ·ä¿¡æ¯ â†’ æ£€æŸ¥æƒé™
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> JWTåƒèº«ä»½è¯ä¸€æ ·ï¼Œä¸€æ—¦é¢å‘å°±æ— æ³•æ’¤é”€ï¼Œæ‰€ä»¥è¦è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´

**JWTçš„ä¼˜åŠ¿**ï¼š
- âœ… **æ— çŠ¶æ€**ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨Sessionä¿¡æ¯  
- âœ… **è·¨åŸŸå‹å¥½**ï¼šå¯ä»¥åœ¨ä¸åŒåŸŸåçš„æœåŠ¡é—´ä½¿ç”¨
- âœ… **è‡ªåŒ…å«**ï¼šTokenæœ¬èº«åŒ…å«æ‰€éœ€çš„ç”¨æˆ·ä¿¡æ¯
- âœ… **æ ‡å‡†åŒ–**ï¼šä¸šç•Œé€šç”¨æ ‡å‡†ï¼Œæœ‰ä¸°å¯Œçš„åº“æ”¯æŒ

### 4.2 API Keyè®¤è¯


**ä½¿ç”¨åœºæ™¯**ï¼šæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„å›ºå®šè®¤è¯ï¼Œç±»ä¼¼äºæœåŠ¡çš„"ç”¨æˆ·åå¯†ç "

```
API Keyä½¿ç”¨ç¤ºä¾‹ï¼š
è®¢å•æœåŠ¡è°ƒç”¨ç”¨æˆ·æœåŠ¡æ—¶ï¼š
POST /api/user/info
Headers:
  X-API-Key: order-service-key-123456
  X-Service-Name: order-service
```

**ç®¡ç†ç­–ç•¥**ï¼š
- **å¯†é’¥è½®æ¢**ï¼šå®šæœŸæ›´æ¢API Key
- **æƒé™æ§åˆ¶**ï¼šä¸åŒæœåŠ¡çš„API Keyæœ‰ä¸åŒæƒé™
- **è®¿é—®ç›‘æ§**ï¼šè®°å½•API Keyçš„ä½¿ç”¨æƒ…å†µ

### 4.3 OAuth 2.0æœåŠ¡é—´è®¤è¯


**åº”ç”¨åœºæ™¯**ï¼šéœ€è¦ç»†ç²’åº¦æƒé™æ§åˆ¶çš„æœåŠ¡é—´è°ƒç”¨

```
OAuthæœåŠ¡é—´è®¤è¯æµç¨‹ï¼š
1. æœåŠ¡Aå‘è®¤è¯ä¸­å¿ƒç”³è¯·è®¿é—®Token
2. è®¤è¯ä¸­å¿ƒéªŒè¯æœåŠ¡Aèº«ä»½åé¢å‘Token
3. æœåŠ¡Aæºå¸¦Tokenè°ƒç”¨æœåŠ¡B
4. æœåŠ¡Bå‘è®¤è¯ä¸­å¿ƒéªŒè¯Tokenæœ‰æ•ˆæ€§
```

---

## 5. ğŸ›¡ï¸ Gatewayç½‘å…³è®¤è¯


### 5.1 ä»€ä¹ˆæ˜¯APIç½‘å…³


**ç®€å•ç†è§£**ï¼šAPIç½‘å…³å°±åƒå•†åœºçš„å¤§é—¨ï¼Œæ‰€æœ‰è¿›å‡ºå•†åœºçš„äººéƒ½è¦ç»è¿‡è¿™é‡Œï¼Œé—¨å«è´Ÿè´£æ£€æŸ¥èº«ä»½å’Œå‘æ”¾é€šè¡Œè¯ã€‚

```
ç½‘å…³æ¶æ„ï¼š
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
å®¢æˆ·ç«¯ â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   API Gateway   â”‚
               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
               â”‚  â”‚  è®¤è¯æˆæƒ  â”‚  â”‚
               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼            â–¼            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ç”¨æˆ·æœåŠ¡â”‚ â”‚å•†å“æœåŠ¡â”‚ â”‚è®¢å•æœåŠ¡â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç½‘å…³è®¤è¯çš„æ ¸å¿ƒåŠŸèƒ½


**ç»Ÿä¸€è®¤è¯å…¥å£**ï¼š
- **èº«ä»½éªŒè¯**ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
- **æƒé™æ§åˆ¶**ï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ç‰¹å®šæœåŠ¡
- **Tokenç®¡ç†**ï¼šé¢å‘ã€åˆ·æ–°ã€æ’¤é”€Token
- **è¯·æ±‚è·¯ç”±**ï¼šå°†è®¤è¯é€šè¿‡çš„è¯·æ±‚è½¬å‘åˆ°å¯¹åº”æœåŠ¡

**ç½‘å…³è®¤è¯æµç¨‹**ï¼š
```
1. ç”¨æˆ·è¯·æ±‚åˆ°è¾¾ç½‘å…³
   GET /api/orders HTTP/1.1
   Authorization: Bearer jwt-token-here

2. ç½‘å…³éªŒè¯Token
   - æ£€æŸ¥Tokenæ ¼å¼æ˜¯å¦æ­£ç¡®
   - éªŒè¯Tokenç­¾åæ˜¯å¦æœ‰æ•ˆ
   - æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ
   - æå–ç”¨æˆ·æƒé™ä¿¡æ¯

3. è¯·æ±‚è½¬å‘
   - éªŒè¯é€šè¿‡ï¼šè½¬å‘åˆ°ç›®æ ‡æœåŠ¡ï¼Œå¹¶æ·»åŠ ç”¨æˆ·ä¿¡æ¯
   - éªŒè¯å¤±è´¥ï¼šç›´æ¥è¿”å›401æœªæˆæƒ
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> ç½‘å…³æˆä¸ºå•ç‚¹æ•…éšœé£é™©ï¼Œéœ€è¦åšå¥½é«˜å¯ç”¨è®¾è®¡

### 5.3 ç½‘å…³è®¤è¯çš„å®ç°æ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šç½‘å…³ç›´æ¥éªŒè¯JWT**
```java
// ä¼ªä»£ç ç¤ºä¾‹
public class GatewayFilter {
    public void doFilter(HttpRequest request) {
        String token = request.getHeader("Authorization");
        
        if (validateJWT(token)) {
            // è§£æç”¨æˆ·ä¿¡æ¯
            User user = parseUserFromJWT(token);
            // æ·»åŠ åˆ°è¯·æ±‚å¤´ï¼Œä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡
            request.addHeader("X-User-Id", user.getId());
            request.addHeader("X-User-Role", user.getRole());
            
            // è½¬å‘è¯·æ±‚
            forwardRequest(request);
        } else {
            return unauthorized();
        }
    }
}
```

**æ–¹æ¡ˆäºŒï¼šç½‘å…³è°ƒç”¨è®¤è¯æœåŠ¡éªŒè¯**
```
ç½‘å…³æ”¶åˆ°è¯·æ±‚ â†’ è°ƒç”¨è®¤è¯æœåŠ¡éªŒè¯Token â†’ æ ¹æ®ç»“æœå†³å®šæ˜¯å¦è½¬å‘
ä¼˜ç‚¹ï¼šè®¤è¯é€»è¾‘é›†ä¸­ç®¡ç†
ç¼ºç‚¹ï¼šå¢åŠ äº†ä¸€æ¬¡ç½‘ç»œè°ƒç”¨å»¶æ—¶
```

---

## 6. ğŸ¢ ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ(SSO)


### 6.1 SSOçš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯SSO**ï¼šSingle Sign-Onï¼Œå•ç‚¹ç™»å½•ã€‚ç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œå°±èƒ½è®¿é—®æ‰€æœ‰ç›¸å…³çš„ç³»ç»Ÿå’ŒæœåŠ¡ã€‚

**ç”Ÿæ´»åŒ–ç†è§£**ï¼šå°±åƒé…’åº—çš„æˆ¿å¡ï¼Œä¸€å¼ å¡å¯ä»¥å¼€æˆ¿é—¨ã€ç”µæ¢¯ã€å¥èº«æˆ¿ç­‰æ‰€æœ‰è®¾æ–½ï¼Œè€Œä¸ç”¨ä¸ºæ¯ä¸ªè®¾æ–½å•ç‹¬åŠå¡ã€‚

```
æ²¡æœ‰SSOçš„ä¸–ç•Œï¼š
ç”¨æˆ· â†’ ç™»å½•ç”¨æˆ·æœåŠ¡ â†’ ä½¿ç”¨å®Œæ¯•
ç”¨æˆ· â†’ ç™»å½•å•†å“æœåŠ¡ â†’ ä½¿ç”¨å®Œæ¯•  
ç”¨æˆ· â†’ ç™»å½•è®¢å•æœåŠ¡ â†’ ä½¿ç”¨å®Œæ¯•
ç”¨æˆ·ï¼šæˆ‘è¦ç™»å½•è¿™ä¹ˆå¤šæ¬¡ï¼ŸğŸ˜«

æœ‰SSOçš„ä¸–ç•Œï¼š
ç”¨æˆ· â†’ ç™»å½•ä¸€æ¬¡SSO â†’ è®¿é—®æ‰€æœ‰æœåŠ¡ â†’ çˆ½ï¼ğŸ˜Š
```

### 6.2 SSOçš„æ ¸å¿ƒç»„ä»¶


**è®¤è¯ä¸­å¿ƒï¼ˆAuthentication Serverï¼‰**ï¼š
- è´Ÿè´£ç”¨æˆ·ç™»å½•éªŒè¯
- é¢å‘å’Œç®¡ç†Token
- ç»´æŠ¤ç”¨æˆ·ä¼šè¯çŠ¶æ€

**å„ä¸ªä¸šåŠ¡æœåŠ¡ï¼ˆService Providerï¼‰**ï¼š
- ä¿¡ä»»è®¤è¯ä¸­å¿ƒ
- éªŒè¯Tokenæœ‰æ•ˆæ€§
- æä¾›ä¸šåŠ¡åŠŸèƒ½

```
SSOæ¶æ„å›¾ï¼š
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è®¤è¯ä¸­å¿ƒ      â”‚
                    â”‚   (SSO Server)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†•
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†•                  â†•                  â†•
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ç”¨æˆ·æœåŠ¡â”‚        â”‚å•†å“æœåŠ¡â”‚        â”‚è®¢å•æœåŠ¡â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 SSOç™»å½•æµç¨‹è¯¦è§£


**å®Œæ•´çš„SSOç™»å½•è¿‡ç¨‹**ï¼š
```
æ­¥éª¤1ï¼šç”¨æˆ·è®¿é—®ä¸šåŠ¡æœåŠ¡
æµè§ˆå™¨ â†’ ç”¨æˆ·æœåŠ¡
ç”¨æˆ·æœåŠ¡å‘ç°ç”¨æˆ·æœªç™»å½• â†’ é‡å®šå‘åˆ°SSOç™»å½•é¡µ

æ­¥éª¤2ï¼šç”¨æˆ·åœ¨SSOä¸­å¿ƒç™»å½•
æµè§ˆå™¨ â†’ SSOç™»å½•é¡µé¢ â†’ è¾“å…¥ç”¨æˆ·åå¯†ç 
SSOéªŒè¯æˆåŠŸ â†’ ç”ŸæˆToken â†’ é‡å®šå‘å›ç”¨æˆ·æœåŠ¡

æ­¥éª¤3ï¼šç”¨æˆ·æœåŠ¡éªŒè¯Token
ç”¨æˆ·æœåŠ¡æ”¶åˆ°Token â†’ å‘SSOéªŒè¯Tokenæœ‰æ•ˆæ€§
éªŒè¯é€šè¿‡ â†’ ç”¨æˆ·æ­£å¸¸ä½¿ç”¨æœåŠ¡

æ­¥éª¤4ï¼šè®¿é—®å…¶ä»–æœåŠ¡ï¼ˆå…ç™»å½•ï¼‰
ç”¨æˆ·è®¿é—®å•†å“æœåŠ¡ â†’ å•†å“æœåŠ¡æ£€æŸ¥Token â†’ ç›´æ¥å…è®¸è®¿é—®
```

> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> SSOçš„å…³é”®åœ¨äº"ä¿¡ä»»"ï¼šæ‰€æœ‰æœåŠ¡éƒ½ä¿¡ä»»åŒä¸€ä¸ªè®¤è¯ä¸­å¿ƒçš„Token

### 6.4 SSOçš„å®ç°æŠ€æœ¯


**CAS (Central Authentication Service)**ï¼š
- ä¼ ç»Ÿçš„SSOè§£å†³æ–¹æ¡ˆ
- åŸºäºç¥¨æ®(Ticket)æœºåˆ¶
- é€‚åˆä¼ä¸šå†…éƒ¨ç³»ç»Ÿ

**SAML (Security Assertion Markup Language)**ï¼š
- åŸºäºXMLçš„æ ‡å‡†
- ä¸»è¦ç”¨äºä¼ä¸šçº§åº”ç”¨
- æ”¯æŒå¤æ‚çš„æƒé™ç®¡ç†

**ç°ä»£æ–¹æ¡ˆï¼šOAuth 2.0 + JWT**ï¼š
- æ›´è½»é‡çº§çš„å®ç°
- é€‚åˆå¾®æœåŠ¡æ¶æ„
- ç§»åŠ¨ç«¯å‹å¥½

---

## 7. ğŸ”’ æœåŠ¡è°ƒç”¨é‰´æƒç­–ç•¥


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡è°ƒç”¨é‰´æƒ


**åœºæ™¯è¯´æ˜**ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¹‹é—´éœ€è¦ç›¸äº’è°ƒç”¨è·å–æ•°æ®ï¼Œä½†å¦‚ä½•ç¡®ä¿è¿™äº›è°ƒç”¨æ˜¯å®‰å…¨çš„ï¼Ÿ

```
é—®é¢˜åœºæ™¯ï¼š
è®¢å•æœåŠ¡éœ€è¦è·å–ç”¨æˆ·ä¿¡æ¯æ¥åˆ›å»ºè®¢å•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  è°ƒç”¨getUserInfo()  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚è®¢å•æœåŠ¡â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ç”¨æˆ·æœåŠ¡â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
1. ç”¨æˆ·æœåŠ¡å¦‚ä½•çŸ¥é“è°ƒç”¨è€…æ˜¯åˆæ³•çš„è®¢å•æœåŠ¡ï¼Ÿ
2. å¦‚ä½•é˜²æ­¢æ¶æ„æœåŠ¡å†’å……è®¢å•æœåŠ¡ï¼Ÿ
3. å¦‚ä½•æ§åˆ¶è®¢å•æœåŠ¡åªèƒ½è®¿é—®å¿…è¦çš„ç”¨æˆ·ä¿¡æ¯ï¼Ÿ
```

### 7.2 æœåŠ¡é—´è®¤è¯ç­–ç•¥


**ç­–ç•¥ä¸€ï¼šåŸºäºæœåŠ¡èº«ä»½çš„è®¤è¯**

æ¯ä¸ªæœåŠ¡éƒ½æœ‰å”¯ä¸€çš„èº«ä»½æ ‡è¯†ï¼Œç±»ä¼¼äºæœåŠ¡çš„"èº«ä»½è¯"

```java
// æœåŠ¡è°ƒç”¨æ—¶æºå¸¦æœåŠ¡èº«ä»½ä¿¡æ¯
@Component
public class UserServiceClient {
    
    public User getUserInfo(String userId) {
        HttpHeaders headers = new HttpHeaders();
        headers.set("X-Service-Id", "order-service");
        headers.set("X-Service-Token", "order-service-secret-key");
        
        return restTemplate.exchange(
            "/api/user/" + userId,
            HttpMethod.GET,
            new HttpEntity<>(headers),
            User.class
        ).getBody();
    }
}
```

**ç­–ç•¥äºŒï¼šåŸºäºç”¨æˆ·Tokençš„é€ä¼ **

å°†ç”¨æˆ·çš„JWT Tokené€ä¼ ç»™ä¸‹æ¸¸æœåŠ¡ï¼Œä¸‹æ¸¸æœåŠ¡éªŒè¯ç”¨æˆ·æƒé™

```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
ç”¨æˆ· â†’ ç½‘å…³(æºå¸¦JWT) â†’ è®¢å•æœåŠ¡(é€ä¼ JWT) â†’ ç”¨æˆ·æœåŠ¡(éªŒè¯JWT)

ä¼˜ç‚¹ï¼šæƒé™æ§åˆ¶ç²¾ç¡®åˆ°ç”¨æˆ·çº§åˆ«
ç¼ºç‚¹ï¼šæœåŠ¡è°ƒç”¨é“¾è·¯é•¿æ—¶Tokenå¯èƒ½è¿‡æœŸ
```

### 7.3 æƒé™æ§åˆ¶ç²’åº¦


**æœåŠ¡çº§æƒé™**ï¼šæ§åˆ¶å“ªäº›æœåŠ¡å¯ä»¥è°ƒç”¨å“ªäº›æœåŠ¡

```
æƒé™é…ç½®ç¤ºä¾‹ï¼š
order-service:
  allowed-to-call:
    - user-service.getUserInfo
    - product-service.getProductInfo
  denied-to-call:
    - user-service.deleteUser
    - payment-service.*
```

**æ–¹æ³•çº§æƒé™**ï¼šæ§åˆ¶æœåŠ¡èƒ½è°ƒç”¨ç›®æ ‡æœåŠ¡çš„å“ªäº›æ–¹æ³•

```java
@RestController
@RequestMapping("/api/user")
public class UserController {
    
    @GetMapping("/{id}")
    @RequireServiceAuth({"order-service", "payment-service"})
    public User getUserInfo(@PathVariable String id) {
        return userService.findById(id);
    }
    
    @DeleteMapping("/{id}")
    @RequireServiceAuth({"admin-service"})  // åªæœ‰ç®¡ç†æœåŠ¡èƒ½åˆ é™¤ç”¨æˆ·
    public void deleteUser(@PathVariable String id) {
        userService.deleteById(id);
    }
}
```

### 7.4 è°ƒç”¨é“¾è·¯è¿½è¸ª


**ä¸ºä»€ä¹ˆéœ€è¦è°ƒç”¨é“¾è·¯è¿½è¸ª**ï¼šåœ¨å¤æ‚çš„å¾®æœåŠ¡è°ƒç”¨é“¾ä¸­ï¼Œéœ€è¦çŸ¥é“è¯·æ±‚çš„å®Œæ•´è·¯å¾„å’Œæ¯ä¸ªç¯èŠ‚çš„æƒé™éªŒè¯æƒ…å†µã€‚

```
è°ƒç”¨é“¾è·¯ç¤ºä¾‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ APIç½‘å…³ â†’ è®¢å•æœåŠ¡ â†’ ç”¨æˆ·æœåŠ¡ â†’ æ•°æ®åº“
                      â†“
                    å•†å“æœåŠ¡ â†’ åº“å­˜æœåŠ¡

æ¯ä¸ªç¯èŠ‚éƒ½éœ€è¦è®°å½•ï¼š
- è°ƒç”¨æ—¶é—´
- è°ƒç”¨æ–¹èº«ä»½
- æƒé™éªŒè¯ç»“æœ
- å“åº”æ—¶é—´
```

**é“¾è·¯è¿½è¸ªçš„å®ç°**ï¼š
```java
// ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„è¿½è¸ªID
@Component
public class TraceInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        String traceId = request.getHeader("X-Trace-Id");
        if (traceId == null) {
            traceId = UUID.randomUUID().toString();
        }
        
        // è®°å½•è°ƒç”¨ä¿¡æ¯
        log.info("Service call: traceId={}, caller={}, method={}", 
                traceId, 
                request.getHeader("X-Service-Id"),
                request.getRequestURI());
        
        return true;
    }
}
```

---

## 8. ğŸ’¼ å¾®æœåŠ¡ä¼šè¯å®æˆ˜æ¡ˆä¾‹


### 8.1 ç”µå•†ç³»ç»Ÿçš„ä¼šè¯ç®¡ç†æ¶æ„


**ç³»ç»Ÿæ¦‚è¿°**ï¼šä¸€ä¸ªå…¸å‹çš„ç”µå•†ç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·ã€å•†å“ã€è®¢å•ã€æ”¯ä»˜ç­‰å¾®æœåŠ¡

```
ç³»ç»Ÿæ¶æ„ï¼š
           å®¢æˆ·ç«¯(Web/Mobile)
                    â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  APIç½‘å…³    â”‚  â† ç»Ÿä¸€è®¤è¯å…¥å£
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“           â†“           â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ç”¨æˆ·æœåŠ¡â”‚ â”‚å•†å“æœåŠ¡â”‚ â”‚è®¢å•æœåŠ¡â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚æ”¯ä»˜æœåŠ¡â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 å…·ä½“å®ç°æ–¹æ¡ˆ


**ç¬¬ä¸€æ­¥ï¼šç”¨æˆ·ç™»å½•æµç¨‹**
```
1. ç”¨æˆ·æäº¤ç™»å½•ä¿¡æ¯åˆ°APIç½‘å…³
   POST /api/auth/login
   {
     "username": "user@example.com",
     "password": "password123"
   }

2. APIç½‘å…³è½¬å‘åˆ°ç”¨æˆ·æœåŠ¡éªŒè¯
   ç”¨æˆ·æœåŠ¡éªŒè¯ç”¨æˆ·åå¯†ç  â†’ ç”ŸæˆJWT Token

3. è¿”å›Tokenç»™å®¢æˆ·ç«¯
   {
     "token": "eyJhbGciOiJIUzI1NiIs...",
     "expires_in": 3600,
     "user_info": {
       "id": "user123",
       "name": "å¼ ä¸‰",
       "role": "customer"
     }
   }
```

**ç¬¬äºŒæ­¥ï¼šè´­ç‰©æµç¨‹ä¸­çš„æœåŠ¡è°ƒç”¨**
```
ç”¨æˆ·ä¸‹å•çš„å®Œæ•´æµç¨‹ï¼š

1. å®¢æˆ·ç«¯å‘èµ·ä¸‹å•è¯·æ±‚
   POST /api/orders
   Authorization: Bearer jwt-token-here
   {
     "product_id": "prod123",
     "quantity": 2
   }

2. APIç½‘å…³éªŒè¯JWTå¹¶è½¬å‘åˆ°è®¢å•æœåŠ¡
   - ç½‘å…³è§£æJWTè·å¾—ç”¨æˆ·ID
   - åœ¨è½¬å‘çš„è¯·æ±‚å¤´ä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯
   
3. è®¢å•æœåŠ¡å¤„ç†è®¢å•
   - è°ƒç”¨å•†å“æœåŠ¡æ£€æŸ¥åº“å­˜
   - è°ƒç”¨ç”¨æˆ·æœåŠ¡éªŒè¯ç”¨æˆ·ä¿¡æ¯
   - åˆ›å»ºè®¢å•è®°å½•

4. æœåŠ¡é—´è°ƒç”¨ç¤ºä¾‹
   è®¢å•æœåŠ¡ â†’ å•†å“æœåŠ¡ï¼š
   GET /api/products/prod123/stock
   X-Service-Id: order-service
   X-User-Id: user123 (ç”±ç½‘å…³æ·»åŠ )
```

### 8.3 å…³é”®æŠ€æœ¯ç»†èŠ‚


**JWT Tokenè®¾è®¡**ï¼š
```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "user_id": "user123",
    "username": "user@example.com",
    "role": "customer",
    "permissions": ["order:create", "order:view"],
    "iat": 1640995200,
    "exp": 1640998800
  }
}
```

**æœåŠ¡é—´è®¤è¯é…ç½®**ï¼š
```yaml
# æœåŠ¡æƒé™é…ç½®
service-auth:
  order-service:
    allowed-calls:
      - "user-service:/api/users/{user_id}"
      - "product-service:/api/products/*/stock"
    secret-key: "order-service-secret-123"
    
  payment-service:
    allowed-calls:
      - "order-service:/api/orders/{order_id}"
      - "user-service:/api/users/{user_id}/payment-info"
    secret-key: "payment-service-secret-456"
```

### 8.4 å¼‚å¸¸å¤„ç†å’Œé™çº§ç­–ç•¥


**Tokenè¿‡æœŸå¤„ç†**ï¼š
```java
@Component
public class AuthenticationFilter {
    
    public void doFilter(HttpServletRequest request) {
        try {
            String token = extractToken(request);
            validateToken(token);
        } catch (TokenExpiredException e) {
            // Tokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°
            String refreshToken = request.getHeader("X-Refresh-Token");
            if (refreshToken != null) {
                String newToken = authService.refreshToken(refreshToken);
                response.setHeader("X-New-Token", newToken);
            } else {
                return unauthorized("Token expired");
            }
        }
    }
}
```

**æœåŠ¡è°ƒç”¨å¤±è´¥é™çº§**ï¼š
```java
@Service
public class OrderService {
    
    @HystrixCommand(fallbackMethod = "createOrderFallback")
    public Order createOrder(OrderRequest request) {
        // æ­£å¸¸çš„è®¢å•åˆ›å»ºæµç¨‹
        // è°ƒç”¨ç”¨æˆ·æœåŠ¡ã€å•†å“æœåŠ¡ç­‰
        return orderRepository.save(order);
    }
    
    // é™çº§æ–¹æ³•ï¼šå½“ä¾èµ–æœåŠ¡ä¸å¯ç”¨æ—¶çš„å¤„ç†
    public Order createOrderFallback(OrderRequest request) {
        // åˆ›å»ºåŸºç¡€è®¢å•ï¼Œç¨åè¡¥å……å®Œæ•´ä¿¡æ¯
        Order basicOrder = new Order();
        basicOrder.setStatus("PENDING_VERIFICATION");
        return basicOrder;
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¾®æœåŠ¡ä¼šè¯æŒ‘æˆ˜ï¼šæœåŠ¡åˆ†ç¦»å¯¼è‡´Sessionæ— æ³•å…±äº«
ğŸ”¸ JWT Tokenï¼šæ— çŠ¶æ€çš„èº«ä»½ä»¤ç‰Œï¼Œæ˜¯å¾®æœåŠ¡è®¤è¯çš„æ ¸å¿ƒ
ğŸ”¸ APIç½‘å…³ï¼šç»Ÿä¸€è®¤è¯å…¥å£ï¼Œç®€åŒ–å®¢æˆ·ç«¯è°ƒç”¨å¤æ‚åº¦
ğŸ”¸ SSOå•ç‚¹ç™»å½•ï¼šä¸€æ¬¡ç™»å½•ï¼Œåˆ°å¤„ä½¿ç”¨çš„ç”¨æˆ·ä½“éªŒ
ğŸ”¸ æœåŠ¡é—´è®¤è¯ï¼šç¡®ä¿æœåŠ¡è°ƒç”¨çš„å®‰å…¨æ€§å’Œåˆæ³•æ€§
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆä¼ ç»ŸSessionä¸é€‚åˆå¾®æœåŠ¡**
```
æ ¹æœ¬åŸå› ï¼š
- å¾®æœåŠ¡éƒ¨ç½²åœ¨ä¸åŒè¿›ç¨‹/æœåŠ¡å™¨ä¸Š
- æ— æ³•ç›´æ¥å…±äº«å†…å­˜ä¸­çš„Session
- éœ€è¦ç½‘ç»œé€šä¿¡æ¥éªŒè¯èº«ä»½

è§£å†³æ€è·¯ï¼š
- ä½¿ç”¨å¤–éƒ¨å­˜å‚¨(Redis)å…±äº«Session
- ä½¿ç”¨æ— çŠ¶æ€Token(JWT)æ›¿ä»£Session
- é€šè¿‡ç½‘å…³ç»Ÿä¸€å¤„ç†è®¤è¯é€»è¾‘
```

**ğŸ”¹ JWT vs Sessionçš„é€‰æ‹©**
```
JWTä¼˜åŠ¿ï¼š
- æ— çŠ¶æ€ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨
- è·¨åŸŸï¼šå¯åœ¨ä¸åŒæœåŠ¡é—´ä½¿ç”¨
- è‡ªåŒ…å«ï¼šåŒ…å«å¿…è¦çš„ç”¨æˆ·ä¿¡æ¯

Sessionä¼˜åŠ¿ï¼š
- å¯æ’¤é”€ï¼šæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨åˆ é™¤Session
- å®‰å…¨æ€§ï¼šæ•æ„Ÿä¿¡æ¯ä¸æš´éœ²åœ¨å®¢æˆ·ç«¯
- ä¼ è¾“æ•ˆç‡ï¼šSessionIDæ¯”JWTçŸ­

å¾®æœåŠ¡æ¨èï¼šJWTç”¨äºæœåŠ¡é—´è®¤è¯ï¼ŒRedis Sessionç”¨äºçŠ¶æ€ç®¡ç†
```

**ğŸ”¹ å¾®æœåŠ¡è®¤è¯çš„å±‚æ¬¡ç»“æ„**
```
ä¸‰å±‚è®¤è¯ä½“ç³»ï¼š
1. ç”¨æˆ·å±‚è®¤è¯ï¼šç¡®è®¤ç”¨æˆ·èº«ä»½ï¼ˆç™»å½•ï¼‰
2. æœåŠ¡å±‚è®¤è¯ï¼šç¡®è®¤æœåŠ¡èº«ä»½ï¼ˆæœåŠ¡é—´è°ƒç”¨ï¼‰
3. æ–¹æ³•å±‚æˆæƒï¼šç¡®è®¤æ“ä½œæƒé™ï¼ˆRBACï¼‰

å®ç°ç­–ç•¥ï¼š
- ç½‘å…³è´Ÿè´£ç”¨æˆ·å±‚è®¤è¯
- æœåŠ¡é—´ä½¿ç”¨API Keyæˆ–æœåŠ¡Token
- ä¸šåŠ¡æ–¹æ³•ä¸­å®ç°æƒé™æ§åˆ¶
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ¶æ„è®¾è®¡å»ºè®®**
```
å°å‹é¡¹ç›®ï¼ˆ< 5ä¸ªæœåŠ¡ï¼‰ï¼š
- ä½¿ç”¨APIç½‘å…³ + JWT Token
- Rediså­˜å‚¨ç”¨æˆ·ä¼šè¯çŠ¶æ€
- ç®€å•çš„æœåŠ¡é—´API Keyè®¤è¯

ä¸­å‹é¡¹ç›®ï¼ˆ5-20ä¸ªæœåŠ¡ï¼‰ï¼š
- å¼•å…¥ä¸“é—¨çš„è®¤è¯ä¸­å¿ƒ(SSO)
- å®ç°å®Œæ•´çš„æœåŠ¡é—´è®¤è¯æœºåˆ¶
- æ·»åŠ è°ƒç”¨é“¾è·¯è¿½è¸ª

å¤§å‹é¡¹ç›®ï¼ˆ> 20ä¸ªæœåŠ¡ï¼‰ï¼š
- å¾®æœåŠ¡ç½‘æ ¼(Service Mesh)
- é›¶ä¿¡ä»»å®‰å…¨æ¶æ„
- è‡ªåŠ¨åŒ–çš„æƒé™ç®¡ç†
```

**ğŸ”§ æœ€ä½³å®è·µ**
```
Tokenè®¾è®¡ï¼š
- åˆç†çš„è¿‡æœŸæ—¶é—´(1-2å°æ—¶)
- åŒ…å«å¿…è¦ä½†ä¸æ•æ„Ÿçš„ä¿¡æ¯
- æ”¯æŒTokenåˆ·æ–°æœºåˆ¶

æœåŠ¡é—´è°ƒç”¨ï¼š
- ä½¿ç”¨HTTPSç¡®ä¿ä¼ è¾“å®‰å…¨
- å®ç°è°ƒç”¨è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- è®°å½•è¯¦ç»†çš„è°ƒç”¨æ—¥å¿—

æƒé™æ§åˆ¶ï¼š
- æœ€å°æƒé™åŸåˆ™
- å®šæœŸå®¡æŸ¥æœåŠ¡æƒé™é…ç½®
- å®ç°æƒé™çš„åŠ¨æ€è°ƒæ•´
```

### 9.4 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**ğŸ› é—®é¢˜ä¸€ï¼šTokenè¿‡æœŸå¯¼è‡´è°ƒç”¨å¤±è´¥**
```
ç°è±¡ï¼šç”¨æˆ·æ­£åœ¨ä½¿ç”¨ç³»ç»Ÿæ—¶çªç„¶éœ€è¦é‡æ–°ç™»å½•
åŸå› ï¼šJWT Tokenè¿‡æœŸï¼Œä¸”æ²¡æœ‰è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
è§£å†³ï¼šå®ç°Tokenè‡ªåŠ¨åˆ·æ–°å’Œæ— æ„ŸçŸ¥ç»­æœŸ
```

**ğŸ”’ é—®é¢˜äºŒï¼šæœåŠ¡é—´è°ƒç”¨çš„å®‰å…¨é£é™©**
```
ç°è±¡ï¼šä»»ä½•çŸ¥é“APIåœ°å€çš„äººéƒ½èƒ½è°ƒç”¨æœåŠ¡
åŸå› ï¼šæ²¡æœ‰å®ç°æœåŠ¡é—´çš„èº«ä»½è®¤è¯
è§£å†³ï¼šä¸ºæ¯ä¸ªæœåŠ¡é…ç½®ç‹¬ç‰¹çš„API Keyæˆ–è¯ä¹¦
```

**âš¡ é—®é¢˜ä¸‰ï¼šç½‘å…³æˆä¸ºæ€§èƒ½ç“¶é¢ˆ**
```
ç°è±¡ï¼šæ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡ç½‘å…³ï¼Œå“åº”é€Ÿåº¦æ…¢
åŸå› ï¼šç½‘å…³æ‰¿æ‹…äº†å¤ªå¤šè®¤è¯å’Œä¸šåŠ¡é€»è¾‘
è§£å†³ï¼šä¼˜åŒ–ç½‘å…³æ€§èƒ½ï¼Œè€ƒè™‘è®¤è¯ç¼“å­˜å’Œè´Ÿè½½å‡è¡¡
```

> ğŸ“– **è®°å¿†å£è¯€**  
> å¾®æœåŠ¡ä¼šè¯ç®¡ç†è®°ä½ï¼šJWTä»¤ç‰Œä¼ èº«ä»½ï¼Œç½‘å…³ç»Ÿä¸€æŠŠé—¨å®ˆï¼ŒæœåŠ¡ä¹‹é—´éœ€è®¤è¯ï¼ŒSSOç™»å½•ç”¨æˆ·çˆ½

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œèº«ä»½è®¤è¯ä»ç®€å•å˜å¤æ‚
- JWT Tokenæ˜¯å¾®æœåŠ¡è®¤è¯çš„æ ‡å‡†é€‰æ‹©
- APIç½‘å…³æ˜¯è®¤è¯æ¶æ„çš„æ ¸å¿ƒæ¢çº½
- æœåŠ¡é—´è°ƒç”¨å¿…é¡»æœ‰å®‰å…¨é˜²æŠ¤æœºåˆ¶
- ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿå®‰å…¨éœ€è¦å¹³è¡¡è€ƒè™‘