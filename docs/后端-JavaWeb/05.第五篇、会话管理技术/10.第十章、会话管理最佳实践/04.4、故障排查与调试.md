---
title: 4ã€æ•…éšœæ’æŸ¥ä¸è°ƒè¯•
---
## ğŸ“š ç›®å½•

1. [ä¼šè¯æ•…éšœåŸºæœ¬è®¤çŸ¥](#1-ä¼šè¯æ•…éšœåŸºæœ¬è®¤çŸ¥)
2. [Sessionä¸¢å¤±æ’æŸ¥](#2-Sessionä¸¢å¤±æ’æŸ¥)
3. [Cookieé—®é¢˜è¯Šæ–­](#3-Cookieé—®é¢˜è¯Šæ–­)
4. [é›†ç¾¤ç¯å¢ƒè°ƒè¯•](#4-é›†ç¾¤ç¯å¢ƒè°ƒè¯•)
5. [æ€§èƒ½é—®é¢˜å®šä½](#5-æ€§èƒ½é—®é¢˜å®šä½)
6. [å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ](#6-å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä¼šè¯æ•…éšœåŸºæœ¬è®¤çŸ¥


### 1.1 ä»€ä¹ˆæ˜¯ä¼šè¯æ•…éšœ


**é€šä¿—ç†è§£ï¼š**
æƒ³è±¡ä½ åœ¨å•†åº—è´­ç‰©ï¼Œåº—å‘˜è®¤è¯†ä½ å¹¶è®°ä½ä½ ä¹°äº†ä»€ä¹ˆï¼Œä½†çªç„¶åº—å‘˜å¤±å¿†äº†ï¼Œä¸è®°å¾—ä½ æ˜¯è°äº†ã€‚è¿™å°±æ˜¯**ä¼šè¯æ•…éšœ** - æœåŠ¡å™¨"å¿˜è®°"äº†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€æˆ–è´­ç‰©è½¦ä¿¡æ¯ã€‚

```
æ­£å¸¸æµç¨‹ï¼šç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨è®°ä½ â†’ ç»§ç»­ä½¿ç”¨ âœ…
æ•…éšœç°è±¡ï¼šç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨å¿˜è®° â†’ éœ€è¦é‡æ–°ç™»å½• âŒ
```

### 1.2 ä¼šè¯æ•…éšœçš„å¸¸è§è¡¨ç°


**ç”¨æˆ·çœ‹åˆ°çš„é—®é¢˜ï¼š**
- ğŸ”¸ **é¢‘ç¹æ‰çº¿**ï¼šåˆšç™»å½•å°±æç¤ºé‡æ–°ç™»å½•
- ğŸ”¸ **è´­ç‰©è½¦æ¸…ç©º**ï¼šæ·»åŠ å•†å“ååˆ·æ–°é¡µé¢å°±æ²¡äº†
- ğŸ”¸ **æƒé™å¼‚å¸¸**ï¼šæ˜æ˜æœ‰æƒé™å´æç¤ºæ— æƒè®¿é—®
- ğŸ”¸ **æ•°æ®ä¸¢å¤±**ï¼šå¡«å†™çš„è¡¨å•æ•°æ®çªç„¶æ¶ˆå¤±

**å¼€å‘è€…çœ‹åˆ°çš„ç°è±¡ï¼š**
- Sessionä¸ºnullæˆ–ä¸å­˜åœ¨
- Cookieå€¼å¼‚å¸¸æˆ–ä¸¢å¤±
- ä¼šè¯è¶…æ—¶è¿‡å¿«
- å¤šæœåŠ¡å™¨é—´æ•°æ®ä¸åŒæ­¥

### 1.3 æ•…éšœå½±å“ä¸¥é‡æ€§åˆ†æ


```
æ•…éšœç­‰çº§è¯„ä¼°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ ä¸¥é‡çº§åˆ«ï¼ˆP0ï¼‰ï¼š                   â”‚
â”‚   â€¢ æ— æ³•ç™»å½•ç³»ç»Ÿ                     â”‚
â”‚   â€¢ æ”¯ä»˜æµç¨‹ä¸­æ–­                     â”‚
â”‚   â€¢ æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¤±æ•ˆ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ ä¸­ç­‰çº§åˆ«ï¼ˆP1ï¼‰ï¼š                   â”‚
â”‚   â€¢ å¶å‘æ€§æ‰çº¿                       â”‚
â”‚   â€¢ éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸                     â”‚
â”‚   â€¢ æ€§èƒ½æ˜æ˜¾ä¸‹é™                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ è½»å¾®çº§åˆ«ï¼ˆP2ï¼‰ï¼š                   â”‚
â”‚   â€¢ ä¸ªåˆ«ç”¨æˆ·åé¦ˆ                     â”‚
â”‚   â€¢ ç‰¹å®šåœºæ™¯ä¸‹å¤ç°                   â”‚
â”‚   â€¢ ä½“éªŒç¨å·®ä½†å¯ç”¨                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ•µï¸ Sessionä¸¢å¤±æ’æŸ¥


### 2.1 Sessionä¸¢å¤±çš„æ ¹æœ¬åŸå› 


**æ¯”å–»è¯´æ˜ï¼š**
Sessionå°±åƒä½ åœ¨é“¶è¡Œçš„å­˜æ¬¾è®°å½•ï¼Œé“¶è¡Œï¼ˆæœåŠ¡å™¨ï¼‰ç»™ä½ ä¸€ä¸ªå­˜æŠ˜å·ç ï¼ˆSessionIDï¼‰ã€‚å¦‚æœå­˜æŠ˜ä¸¢äº†ã€é“¶è¡Œæ¬è¿äº†ã€æˆ–è€…è®°å½•è¢«æ¸…é™¤äº†ï¼Œä½ å°±æ‰¾ä¸åˆ°ä½ çš„é’±äº†ã€‚

**æŠ€æœ¯åŸç†ï¼š**
- **SessionIDä¸¢å¤±**ï¼šå®¢æˆ·ç«¯cookieè¢«åˆ é™¤æˆ–å¤±æ•ˆ
- **Sessionæ•°æ®æ¸…é™¤**ï¼šæœåŠ¡å™¨å†…å­˜æ¸…ç†æˆ–é‡å¯
- **è¶…æ—¶æœºåˆ¶è§¦å‘**ï¼šSessionåœ¨æŒ‡å®šæ—¶é—´å†…æ— è®¿é—®
- **å­˜å‚¨æ•…éšœ**ï¼šSessionå­˜å‚¨ä»‹è´¨å‡ºç°é—®é¢˜

### 2.2 Sessionä¸¢å¤±æ’æŸ¥æ­¥éª¤


**ğŸ”¸ ç¬¬ä¸€æ­¥ï¼šç¡®è®¤SessionIDæ˜¯å¦å­˜åœ¨**

```java
// æ£€æŸ¥å½“å‰è¯·æ±‚æ˜¯å¦æœ‰SessionID
public void checkSessionId(HttpServletRequest request) {
    String sessionId = request.getRequestedSessionId();
    if (sessionId == null) {
        System.out.println("âŒ å®¢æˆ·ç«¯æ²¡æœ‰å‘é€SessionID");
    } else {
        System.out.println("âœ… SessionIDå­˜åœ¨: " + sessionId);
        
        // æ£€æŸ¥Sessionæ˜¯å¦æœ‰æ•ˆ
        if (!request.isRequestedSessionIdValid()) {
            System.out.println("âŒ SessionIDæ— æ•ˆï¼Œå¯èƒ½å·²è¿‡æœŸ");
        }
    }
}
```

**ğŸ”¸ ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥Sessioné…ç½®**

| é…ç½®é¡¹ | æ£€æŸ¥å†…å®¹ | å¸¸è§é—®é¢˜ |
|--------|----------|----------|
| **è¶…æ—¶æ—¶é—´** | `session-timeout`è®¾ç½® | è®¾ç½®è¿‡çŸ­å¯¼è‡´é¢‘ç¹è¶…æ—¶ |
| **Cookieé…ç½®** | `httpOnly`ã€`secure`å±æ€§ | å±æ€§è®¾ç½®ä¸å½“å¯¼è‡´æ— æ³•ä¼ è¾“ |
| **åŸŸåé…ç½®** | `domain`ã€`path`è®¾ç½® | ä½œç”¨åŸŸä¸åŒ¹é…å¯¼è‡´è·å–å¤±è´¥ |
| **å­˜å‚¨æ–¹å¼** | å†…å­˜/æ•°æ®åº“/Redis | å­˜å‚¨ä»‹è´¨æ•…éšœæˆ–é…ç½®é”™è¯¯ |

**ğŸ”¸ ç¬¬ä¸‰æ­¥ï¼šæ—¥å¿—åˆ†ææ³•**

```java
// æ·»åŠ è¯¦ç»†çš„Sessionç”Ÿå‘½å‘¨æœŸæ—¥å¿—
public class SessionDebugFilter implements Filter {
    public void doFilter(ServletRequest req, ServletResponse resp, 
                        FilterChain chain) {
        HttpServletRequest request = (HttpServletRequest) req;
        
        // è¯·æ±‚å‰çŠ¶æ€
        HttpSession oldSession = request.getSession(false);
        System.out.println("ğŸ” è¯·æ±‚å‰Session: " + 
            (oldSession == null ? "ä¸å­˜åœ¨" : oldSession.getId()));
        
        chain.doFilter(req, resp);
        
        // è¯·æ±‚åçŠ¶æ€
        HttpSession newSession = request.getSession(false);
        System.out.println("ğŸ” è¯·æ±‚åSession: " + 
            (newSession == null ? "ä¸å­˜åœ¨" : newSession.getId()));
    }
}
```

### 2.3 Sessionä¸¢å¤±çš„è§£å†³ç­–ç•¥


**ğŸ’¡ ç«‹å³è§£å†³æ–¹æ¡ˆï¼š**
```
é—®é¢˜ï¼šSessionè¶…æ—¶è¿‡å¿«
è§£å†³ï¼šå»¶é•¿è¶…æ—¶æ—¶é—´
é…ç½®ï¼š<session-timeout>60</session-timeout> ï¼ˆåˆ†é’Ÿï¼‰

é—®é¢˜ï¼šæœåŠ¡å™¨é‡å¯å¯¼è‡´Sessionä¸¢å¤±  
è§£å†³ï¼šä½¿ç”¨æŒä¹…åŒ–Sessionå­˜å‚¨
æ–¹æ¡ˆï¼šRedisã€æ•°æ®åº“å­˜å‚¨

é—®é¢˜ï¼šå¤šåŸŸåå¯¼è‡´Sessionä¸å…±äº«
è§£å†³ï¼šç»Ÿä¸€SessionåŸŸé…ç½®
è®¾ç½®ï¼šcookie-configä¸­é…ç½®domain
```

---

## 3. ğŸª Cookieé—®é¢˜è¯Šæ–­


### 3.1 Cookieå·¥ä½œæœºåˆ¶å›é¡¾


**ç”Ÿæ´»ç±»æ¯”ï¼š**
Cookieåƒæ˜¯å•†åº—ç»™ä½ çš„ä¼šå‘˜å¡ï¼Œæ¯æ¬¡æ¥åº—é‡Œéƒ½è¦å‡ºç¤ºã€‚å¦‚æœå¡ä¸¢äº†ã€è¿‡æœŸäº†ã€æˆ–è€…åº—å‘˜çœ‹ä¸æ‡‚å¡ä¸Šçš„ä¿¡æ¯ï¼Œå°±æ— æ³•äº«å—ä¼šå‘˜æœåŠ¡ã€‚

```
Cookieä¼ è¾“æµç¨‹ï¼š
å®¢æˆ·ç«¯ â†’ å‘é€è¯·æ±‚ â†’ æœåŠ¡å™¨
       â† è¿”å›Cookie â†
       â†’ æºå¸¦Cookie â†’ æœåŠ¡å™¨è¯†åˆ«
```

### 3.2 Cookieé—®é¢˜è¯Šæ–­å·¥å…·


**ğŸ”§ æµè§ˆå™¨å¼€å‘è€…å·¥å…·è¯Šæ–­ï¼š**

```
Chrome DevToolsä½¿ç”¨æ­¥éª¤ï¼š
1. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ°"Application"æ ‡ç­¾é¡µ  
3. å·¦ä¾§é€‰æ‹©"Cookies"
4. æŸ¥çœ‹å½“å‰åŸŸä¸‹çš„æ‰€æœ‰Cookie

æ£€æŸ¥è¦ç‚¹ï¼š
âœ… Cookieæ˜¯å¦å­˜åœ¨
âœ… å€¼æ˜¯å¦æ­£ç¡®  
âœ… è¿‡æœŸæ—¶é—´æ˜¯å¦åˆç†
âœ… Domainå’ŒPathæ˜¯å¦åŒ¹é…
âœ… HttpOnlyå’ŒSecureæ ‡è®°
```

**ğŸ”§ æœåŠ¡å™¨ç«¯è¯Šæ–­ä»£ç ï¼š**

```java
// å…¨é¢çš„Cookieè¯Šæ–­æ–¹æ³•
public void diagnoseCookies(HttpServletRequest request) {
    Cookie[] cookies = request.getCookies();
    
    if (cookies == null || cookies.length == 0) {
        System.out.println("âŒ æ²¡æœ‰æ”¶åˆ°ä»»ä½•Cookie");
        return;
    }
    
    System.out.println("ğŸ“‹ æ”¶åˆ°çš„Cookieåˆ—è¡¨ï¼š");
    for (Cookie cookie : cookies) {
        System.out.println("ğŸ”¸ åç§°: " + cookie.getName());
        System.out.println("   å€¼: " + cookie.getValue());
        System.out.println("   åŸŸ: " + cookie.getDomain());
        System.out.println("   è·¯å¾„: " + cookie.getPath());
        System.out.println("   è¿‡æœŸ: " + cookie.getMaxAge());
        System.out.println("   å®‰å…¨: " + cookie.getSecure());
        System.out.println("   ----------------");
    }
}
```

### 3.3 å¸¸è§Cookieé—®é¢˜åŠè§£å†³


**é—®é¢˜1ï¼šCookieè¢«æµè§ˆå™¨æ‹’ç»**
```
åŸå› åˆ†æï¼š
- æµè§ˆå™¨éšç§è®¾ç½®ç¦ç”¨Cookie
- è·¨åŸŸè¯·æ±‚Cookieè¢«é˜»æ­¢
- SameSiteå±æ€§è®¾ç½®ä¸å½“

è§£å†³æ–¹æ¡ˆï¼š
âœ… æ£€æŸ¥æµè§ˆå™¨Cookieè®¾ç½®
âœ… é…ç½®æ­£ç¡®çš„SameSiteå±æ€§
âœ… HTTPSç¯å¢ƒä¸‹ä½¿ç”¨Secureå±æ€§
```

**é—®é¢˜2ï¼šCookieå€¼å¼‚å¸¸**
```java
// Cookieå€¼éªŒè¯å’Œä¿®å¤
public boolean validateAndFixCookie(HttpServletRequest request, 
                                  HttpServletResponse response) {
    Cookie sessionCookie = getCookie(request, "JSESSIONID");
    
    if (sessionCookie == null) {
        System.out.println("âŒ æœªæ‰¾åˆ°SessionID Cookie");
        return false;
    }
    
    String sessionId = sessionCookie.getValue();
    
    // æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®
    if (!isValidSessionId(sessionId)) {
        System.out.println("âŒ SessionIDæ ¼å¼ä¸æ­£ç¡®: " + sessionId);
        // æ¸…é™¤æ— æ•ˆCookie
        Cookie newCookie = new Cookie("JSESSIONID", null);
        newCookie.setMaxAge(0);
        response.addCookie(newCookie);
        return false;
    }
    
    return true;
}
```

---

## 4. ğŸŒ é›†ç¾¤ç¯å¢ƒè°ƒè¯•


### 4.1 é›†ç¾¤ç¯å¢ƒä¼šè¯é—®é¢˜ç‰¹ç‚¹


**å½¢è±¡è¯´æ˜ï¼š**
é›†ç¾¤å°±åƒä¸€ä¸ªè¿é”åº—ï¼Œä½ åœ¨Aåº—åŠçš„ä¼šå‘˜å¡åˆ°Båº—å¯èƒ½ä¸è®¤ã€‚å¦‚æœå„åˆ†åº—ä¹‹é—´ä¸å…±äº«ä¼šå‘˜ä¿¡æ¯ï¼Œä½ å°±éœ€è¦åœ¨æ¯ä¸ªåº—é‡æ–°åŠå¡ã€‚

```
é›†ç¾¤ä¼šè¯é—®é¢˜ç¤ºæ„ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ æœåŠ¡å™¨Aï¼ˆæœ‰Sessionï¼‰
         â†³ ä¸‹æ¬¡è¯·æ±‚ â†’ æœåŠ¡å™¨Bï¼ˆæ— Sessionï¼‰âŒ

ç†æƒ³çŠ¶æ€ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ æœåŠ¡å™¨A â†â†’ å…±äº«å­˜å‚¨ â†â†’ æœåŠ¡å™¨B
```

### 4.2 é›†ç¾¤ç¯å¢ƒè°ƒè¯•ç­–ç•¥


**ğŸ”¸ ä¼šè¯ç²˜æ€§ï¼ˆSession Stickyï¼‰è°ƒè¯•ï¼š**

```java
// éªŒè¯è¯·æ±‚æ˜¯å¦è·¯ç”±åˆ°åŒä¸€æœåŠ¡å™¨
public void debugServerRouting(HttpServletRequest request) {
    String serverInfo = System.getProperty("server.name", "unknown");
    String sessionId = request.getSession().getId();
    
    System.out.println("ğŸ–¥ï¸ å½“å‰æœåŠ¡å™¨: " + serverInfo);
    System.out.println("ğŸ“ SessionID: " + sessionId);
    
    // è®°å½•åˆ°Sessionä¸­ä¾¿äºè¿½è¸ª
    request.getSession().setAttribute("SERVER_INFO", serverInfo);
}
```

**ğŸ”¸ å…±äº«å­˜å‚¨è°ƒè¯•ï¼š**

| å­˜å‚¨æ–¹æ¡ˆ | è°ƒè¯•é‡ç‚¹ | å¸¸è§é—®é¢˜ |
|----------|----------|----------|
| **Redisé›†ç¾¤** | è¿æ¥çŠ¶æ€ã€æ•°æ®åŒæ­¥ | ç½‘ç»œå»¶è¿Ÿã€æ•°æ®ä¸ä¸€è‡´ |
| **æ•°æ®åº“** | è¿æ¥æ± ã€æŸ¥è¯¢æ€§èƒ½ | é”ç«äº‰ã€å“åº”æ…¢ |
| **å†…å­˜ç½‘æ ¼** | èŠ‚ç‚¹çŠ¶æ€ã€å¤åˆ¶æœºåˆ¶ | ç½‘ç»œåˆ†åŒºã€æ•°æ®ä¸¢å¤± |

**ğŸ”¸ è´Ÿè½½å‡è¡¡å™¨é…ç½®æ£€æŸ¥ï¼š**

```nginx
# Nginxä¼šè¯ç²˜æ€§é…ç½®ç¤ºä¾‹
upstream backend {
    ip_hash;  # åŸºäºå®¢æˆ·ç«¯IPçš„ä¸€è‡´æ€§å“ˆå¸Œ
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
}

server {
    location / {
        proxy_pass http://backend;
        # ä¼ é€’Sessionç›¸å…³çš„å¤´ä¿¡æ¯
        proxy_set_header Cookie $http_cookie;
    }
}
```

### 4.3 é›†ç¾¤è°ƒè¯•å·¥å…·


**ğŸ“Š ç›‘æ§å’Œè¯Šæ–­å·¥å…·ï¼š**

```
é›†ç¾¤çŠ¶æ€æ£€æŸ¥æ¸…å•ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” è´Ÿè½½å‡è¡¡å™¨çŠ¶æ€                   â”‚ 
â”‚   â€¢ å„èŠ‚ç‚¹å¥åº·çŠ¶æ€                 â”‚
â”‚   â€¢ è¯·æ±‚åˆ†å‘æ¯”ä¾‹                   â”‚
â”‚   â€¢ ä¼šè¯ç²˜æ€§æ˜¯å¦ç”Ÿæ•ˆ               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” å…±äº«å­˜å‚¨çŠ¶æ€                     â”‚
â”‚   â€¢ è¿æ¥æ± ä½¿ç”¨æƒ…å†µ                 â”‚  
â”‚   â€¢ æ•°æ®åŒæ­¥å»¶è¿Ÿ                   â”‚
â”‚   â€¢ å­˜å‚¨ç©ºé—´ä½¿ç”¨ç‡                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” åº”ç”¨èŠ‚ç‚¹çŠ¶æ€                     â”‚
â”‚   â€¢ JVMå†…å­˜ä½¿ç”¨                    â”‚
â”‚   â€¢ Sessionåˆ›å»º/é”€æ¯é€Ÿç‡           â”‚
â”‚   â€¢ é”™è¯¯æ—¥å¿—ç»Ÿè®¡                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. âš¡ æ€§èƒ½é—®é¢˜å®šä½


### 5.1 ä¼šè¯æ€§èƒ½é—®é¢˜è¡¨ç°


**ç”¨æˆ·æ„ŸçŸ¥çš„æ€§èƒ½é—®é¢˜ï¼š**
- ğŸ”¸ ç™»å½•å“åº”æ…¢ï¼ˆ>3ç§’ï¼‰
- ğŸ”¸ é¡µé¢åˆ‡æ¢å¡é¡¿
- ğŸ”¸ å¹¶å‘ç”¨æˆ·å¢åŠ æ—¶ç³»ç»Ÿå˜æ…¢
- ğŸ”¸ ç‰¹å®šæ—¶é—´æ®µå“åº”å¼‚å¸¸

**ç³»ç»Ÿå±‚é¢çš„æ€§èƒ½æŒ‡æ ‡ï¼š**
```
å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼ˆKPIsï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ å“åº”æ—¶é—´æŒ‡æ ‡                     â”‚
â”‚   â€¢ Sessionåˆ›å»ºæ—¶é—´: <50ms          â”‚
â”‚   â€¢ SessionæŸ¥è¯¢æ—¶é—´: <10ms          â”‚
â”‚   â€¢ Cookieè®¾ç½®æ—¶é—´: <5ms            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ˆ ååé‡æŒ‡æ ‡                       â”‚
â”‚   â€¢ å¹¶å‘Sessionæ•°: >10000           â”‚
â”‚   â€¢ æ¯ç§’è¯·æ±‚æ•°: >1000 QPS           â”‚
â”‚   â€¢ Sessionå­˜å‚¨å®¹é‡: >1GB           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ˆ èµ„æºä½¿ç”¨æŒ‡æ ‡                     â”‚
â”‚   â€¢ å†…å­˜ä½¿ç”¨ç‡: <80%                â”‚
â”‚   â€¢ CPUä½¿ç”¨ç‡: <70%                 â”‚
â”‚   â€¢ ç½‘ç»œå»¶è¿Ÿ: <50ms                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ€§èƒ½é—®é¢˜è¯Šæ–­æ–¹æ³•


**ğŸ”§ ä»£ç çº§æ€§èƒ½åˆ†æï¼š**

```java
// Sessionæ“ä½œæ€§èƒ½ç›‘æ§
public class SessionPerformanceMonitor {
    
    public void monitorSessionCreation(HttpServletRequest request) {
        long startTime = System.currentTimeMillis();
        
        HttpSession session = request.getSession(true);
        
        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;
        
        if (duration > 100) { // è¶…è¿‡100mså°±å‘Šè­¦
            System.out.println("âš ï¸ Sessionåˆ›å»ºè€—æ—¶è¿‡é•¿: " + duration + "ms");
        }
        
        // è®°å½•åˆ°ç›‘æ§ç³»ç»Ÿ
        logPerformanceMetric("session.creation.time", duration);
    }
    
    public void monitorSessionSize(HttpSession session) {
        // ä¼°ç®—Sessionå¤§å°
        int attributeCount = 0;
        long estimatedSize = 0;
        
        Enumeration<String> names = session.getAttributeNames();
        while (names.hasMoreElements()) {
            String name = names.nextElement();
            Object value = session.getAttribute(name);
            attributeCount++;
            // è¿™é‡Œå¯ä»¥æ·»åŠ å¯¹è±¡å¤§å°ä¼°ç®—é€»è¾‘
        }
        
        if (attributeCount > 50) {
            System.out.println("âš ï¸ Sessionå±æ€§è¿‡å¤š: " + attributeCount);
        }
    }
}
```

**ğŸ”§ ç³»ç»Ÿçº§æ€§èƒ½ç›‘æ§ï¼š**

```java
// JVMå’Œç³»ç»Ÿèµ„æºç›‘æ§
public class SystemResourceMonitor {
    
    public void checkMemoryUsage() {
        Runtime runtime = Runtime.getRuntime();
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        long usedMemory = totalMemory - freeMemory;
        
        double usagePercentage = (double) usedMemory / totalMemory * 100;
        
        if (usagePercentage > 80) {
            System.out.println("ğŸ”´ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: " + 
                             String.format("%.2f%%", usagePercentage));
        }
    }
    
    public void checkActiveSessionCount() {
        // è¿™éœ€è¦æ ¹æ®å…·ä½“çš„Sessionç®¡ç†å™¨å®ç°
        // ä¾‹å¦‚Tomcatçš„Manageræ¥å£
        int activeSessions = getActiveSessionCount();
        
        if (activeSessions > 10000) {
            System.out.println("âš ï¸ æ´»è·ƒSessionæ•°é‡è¿‡å¤š: " + activeSessions);
        }
    }
}
```

### 5.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ’¡ å¸¸è§ä¼˜åŒ–ç­–ç•¥ï¼š**

| ä¼˜åŒ–æ–¹å‘ | å…·ä½“æªæ–½ | é¢„æœŸæ•ˆæœ |
|----------|----------|----------|
| **Sessionå¤§å°** | å‡å°‘å­˜å‚¨æ•°æ®é‡ï¼Œä½¿ç”¨å¼•ç”¨ä»£æ›¿å¯¹è±¡ | å†…å­˜ä½¿ç”¨å‡å°‘50% |
| **è¿‡æœŸç­–ç•¥** | åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ŒåŠæ—¶æ¸…ç† | æ´»è·ƒSessionå‡å°‘30% |
| **å­˜å‚¨æ–¹å¼** | Redisæ›¿ä»£å†…å­˜å­˜å‚¨ | æ”¯æŒæ›´å¤šå¹¶å‘ç”¨æˆ· |
| **åºåˆ—åŒ–** | ä½¿ç”¨é«˜æ•ˆåºåˆ—åŒ–æ–¹æ¡ˆ | I/Oæ€§èƒ½æå‡20% |

**ğŸ¯ æ€§èƒ½è°ƒä¼˜å®è·µï¼š**
```java
// Sessionæ•°æ®ç²¾ç®€ç¤ºä¾‹
// âŒ ä¸å¥½çš„åšæ³•ï¼šå­˜å‚¨å¤§é‡æ•°æ®
session.setAttribute("user", userEntity); // å¯èƒ½åŒ…å«å¾ˆå¤šä¸å¿…è¦å­—æ®µ

// âœ… å¥½çš„åšæ³•ï¼šåªå­˜å‚¨å¿…è¦ä¿¡æ¯  
UserSession userSession = new UserSession();
userSession.setUserId(user.getId());
userSession.setUsername(user.getUsername());
userSession.setRoles(user.getRoles());
session.setAttribute("userSession", userSession);
```

---

## 6. ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ


### 6.1 é¢‘ç¹æ‰çº¿é—®é¢˜


**é—®é¢˜ç°è±¡ï¼š**
```
ç”¨æˆ·åé¦ˆï¼šåˆšç™»å½•è¿›å»ï¼Œç‚¹å‡»å‡ ä¸ªé¡µé¢å°±æç¤ºè¦é‡æ–°ç™»å½•
å¼€å‘è€…è§‚å¯Ÿï¼šSessionå¾ˆå¿«å°±å¤±æ•ˆï¼Œç”¨æˆ·éœ€è¦é¢‘ç¹ç™»å½•
```

**é—®é¢˜æ’æŸ¥æ­¥éª¤ï¼š**
```
ğŸ” æ’æŸ¥æ¸…å•ï¼š
1. æ£€æŸ¥Sessionè¶…æ—¶é…ç½®ï¼ˆweb.xmlä¸­çš„session-timeoutï¼‰
2. ç¡®è®¤Cookieçš„MaxAgeè®¾ç½®
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¶é’Ÿæ˜¯å¦åŒæ­¥
4. éªŒè¯è´Ÿè½½å‡è¡¡æ˜¯å¦é…ç½®Sessionç²˜æ€§
5. æ£€æŸ¥æ˜¯å¦æœ‰ä»£ç ä¸»åŠ¨è°ƒç”¨session.invalidate()
```

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// 1. è°ƒæ•´Sessionè¶…æ—¶æ—¶é—´ï¼ˆweb.xmlï¼‰
<session-config>
    <session-timeout>120</session-timeout> <!-- æ”¹ä¸º120åˆ†é’Ÿ -->
</session-config>

// 2. å»¶é•¿Cookieæœ‰æ•ˆæœŸ
Cookie sessionCookie = new Cookie("JSESSIONID", sessionId);
sessionCookie.setMaxAge(7200); // 2å°æ—¶
response.addCookie(sessionCookie);

// 3. å®ç°Sessionåˆ·æ–°æœºåˆ¶
public void refreshSession(HttpServletRequest request) {
    HttpSession session = request.getSession(false);
    if (session != null) {
        // æ›´æ–°æœ€åè®¿é—®æ—¶é—´
        session.setMaxInactiveInterval(1800); // 30åˆ†é’Ÿ
    }
}
```

### 6.2 è·¨åŸŸSessioné—®é¢˜


**é—®é¢˜ç°è±¡ï¼š**
```
åœºæ™¯ï¼šä¸»ç«™ www.example.com å’Œ API api.example.com 
ç°è±¡ï¼šä¸»ç«™ç™»å½•åï¼Œè°ƒç”¨APIæ¥å£æç¤ºæœªç™»å½•
åŸå› ï¼šCookieçš„åŸŸè®¾ç½®å¯¼è‡´è·¨å­åŸŸæ— æ³•å…±äº«Session
```

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// è®¾ç½®Cookieä¸ºé¡¶çº§åŸŸå
public void setCrossDomainSession(HttpServletResponse response, 
                                String sessionId) {
    Cookie cookie = new Cookie("JSESSIONID", sessionId);
    cookie.setDomain(".example.com"); // æ³¨æ„å‰é¢çš„ç‚¹å·
    cookie.setPath("/");
    cookie.setHttpOnly(true);
    response.addCookie(cookie);
}

// æˆ–è€…ä½¿ç”¨CORSé…ç½®å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦Cookie
@CrossOrigin(origins = "http://www.example.com", 
            allowCredentials = "true")
public class ApiController {
    // APIä»£ç 
}
```

### 6.3 é›†ç¾¤ç¯å¢ƒSessionä¸åŒæ­¥


**é—®é¢˜ç°è±¡ï¼š**
```
åœºæ™¯ï¼šç”¨æˆ·åœ¨æœåŠ¡å™¨Aç™»å½•ï¼Œè¯·æ±‚è¢«åˆ†å‘åˆ°æœåŠ¡å™¨Bæ—¶æç¤ºæœªç™»å½•
åŸå› ï¼šå„æœåŠ¡å™¨èŠ‚ç‚¹çš„Sessionæ²¡æœ‰å…±äº«
```

**è§£å†³æ–¹æ¡ˆæ¶æ„ï¼š**
```
è§£å†³æ–¹æ¡ˆå¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–¹æ¡ˆ1ï¼šSessionç²˜æ€§                  â”‚
â”‚ ä¼˜ç‚¹ï¼šç®€å•æ˜“å®ç°ï¼Œæ€§èƒ½å¥½             â”‚
â”‚ ç¼ºç‚¹ï¼šå•ç‚¹æ•…éšœï¼Œè´Ÿè½½ä¸å‡è¡¡           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ æ–¹æ¡ˆ2ï¼šSessionå¤åˆ¶                  â”‚
â”‚ ä¼˜ç‚¹ï¼šé«˜å¯ç”¨ï¼Œæ•°æ®ä¸€è‡´æ€§å¥½           â”‚
â”‚ ç¼ºç‚¹ï¼šç½‘ç»œå¼€é”€å¤§ï¼Œæ‰©å±•æ€§å·®           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–¹æ¡ˆ3ï¼šé›†ä¸­å¼Sessionå­˜å‚¨             â”‚
â”‚ ä¼˜ç‚¹ï¼šæ‰©å±•æ€§å¥½ï¼Œæ•°æ®ä¸€è‡´æ€§å¼º         â”‚
â”‚ ç¼ºç‚¹ï¼šå¢åŠ å¤æ‚åº¦ï¼Œä¾èµ–å¤–éƒ¨å­˜å‚¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Redisé›†ä¸­å­˜å‚¨å®ç°ï¼š**
```java
// Spring Session + Redisé…ç½®
@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800)
@Configuration
public class SessionConfig {
    
    @Bean
    public LettuceConnectionFactory connectionFactory() {
        return new LettuceConnectionFactory(
            new RedisStandaloneConfiguration("redis-server", 6379));
    }
}
```

### 6.4 SessionåŠ«æŒå®‰å…¨é—®é¢˜


**é—®é¢˜è®¤çŸ¥ï¼š**
```
æ”»å‡»æ–¹å¼ï¼šæ”»å‡»è€…è·å–åˆ°ç”¨æˆ·çš„SessionIDï¼Œå†’å……ç”¨æˆ·èº«ä»½
å±å®³ç¨‹åº¦ï¼šé«˜ï¼ˆå¯èƒ½å¯¼è‡´è´¦æˆ·è¢«ç›—ç”¨ï¼Œæ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼‰
é˜²æŠ¤å¿…è¦æ€§ï¼šæ‰€æœ‰ç”Ÿäº§ç¯å¢ƒéƒ½åº”è¯¥è€ƒè™‘æ­¤é—®é¢˜
```

**é˜²æŠ¤æªæ–½ï¼š**
```java
// 1. ä½¿ç”¨HTTPSä¼ è¾“
// ç¡®ä¿Cookieåªåœ¨å®‰å…¨è¿æ¥ä¸­ä¼ è¾“
Cookie sessionCookie = new Cookie("JSESSIONID", sessionId);
sessionCookie.setSecure(true);  // åªåœ¨HTTPSä¸‹ä¼ è¾“
sessionCookie.setHttpOnly(true); // é˜²æ­¢JSè®¿é—®

// 2. å®šæœŸåˆ·æ–°SessionID
public void regenerateSessionId(HttpServletRequest request) {
    HttpSession oldSession = request.getSession(false);
    if (oldSession != null) {
        // ä¿å­˜åŸæœ‰æ•°æ®
        Enumeration<String> attributeNames = oldSession.getAttributeNames();
        Map<String, Object> attributes = new HashMap<>();
        while (attributeNames.hasMoreElements()) {
            String name = attributeNames.nextElement();
            attributes.put(name, oldSession.getAttribute(name));
        }
        
        // é”€æ¯æ—§Session
        oldSession.invalidate();
        
        // åˆ›å»ºæ–°Sessionå¹¶æ¢å¤æ•°æ®
        HttpSession newSession = request.getSession(true);
        for (Map.Entry<String, Object> entry : attributes.entrySet()) {
            newSession.setAttribute(entry.getKey(), entry.getValue());
        }
    }
}

// 3. IPåœ°å€éªŒè¯
public boolean validateSessionSecurity(HttpServletRequest request) {
    HttpSession session = request.getSession(false);
    if (session == null) return false;
    
    String currentIP = request.getRemoteAddr();
    String sessionIP = (String) session.getAttribute("CLIENT_IP");
    
    if (sessionIP == null) {
        // é¦–æ¬¡è®¿é—®ï¼Œè®°å½•IP
        session.setAttribute("CLIENT_IP", currentIP);
        return true;
    }
    
    // éªŒè¯IPæ˜¯å¦ä¸€è‡´
    if (!currentIP.equals(sessionIP)) {
        System.out.println("âš ï¸ Sessionå¯èƒ½è¢«åŠ«æŒï¼ŒIPä¸åŒ¹é…ï¼š" + 
                          sessionIP + " vs " + currentIP);
        session.invalidate();
        return false;
    }
    
    return true;
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 æ•…éšœæ’æŸ¥æ ¸å¿ƒæ€è·¯


**ğŸ” ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•ï¼š**
```
æ•…éšœæ’æŸ¥ä¸‰æ­¥æ³•ï¼š
1ï¸âƒ£ ç°è±¡è§‚å¯Ÿ â†’ æ”¶é›†ç”¨æˆ·åé¦ˆå’Œç³»ç»Ÿè¡¨ç°
2ï¸âƒ£ åŸå› åˆ†æ â†’ æ ¹æ®ç°è±¡æ¨æ–­å¯èƒ½çš„æŠ€æœ¯åŸå›   
3ï¸âƒ£ è§£å†³éªŒè¯ â†’ å®æ–½è§£å†³æ–¹æ¡ˆå¹¶éªŒè¯æ•ˆæœ

æŠ€æœ¯æ’æŸ¥é¡ºåºï¼š
å®¢æˆ·ç«¯Cookie â†’ ç½‘ç»œä¼ è¾“ â†’ æœåŠ¡å™¨Session â†’ å­˜å‚¨å±‚
```

**ğŸ“Š é—®é¢˜åˆ†ç±»å¤„ç†ï¼š**

| é—®é¢˜ç±»å‹ | æ’æŸ¥é‡ç‚¹ | è§£å†³ç­–ç•¥ | é¢„é˜²æªæ–½ |
|----------|----------|----------|----------|
| **Sessionä¸¢å¤±** | è¶…æ—¶è®¾ç½®ã€å­˜å‚¨çŠ¶æ€ | å»¶é•¿è¶…æ—¶ã€æŒä¹…åŒ–å­˜å‚¨ | ç›‘æ§å‘Šè­¦ã€å®šæœŸå¤‡ä»½ |
| **Cookieå¼‚å¸¸** | åŸŸåè®¾ç½®ã€å®‰å…¨å±æ€§ | é‡æ–°é…ç½®ã€æ¸…é™¤æ— æ•ˆ | æ ‡å‡†åŒ–é…ç½®ã€æµ‹è¯•éªŒè¯ |
| **æ€§èƒ½é—®é¢˜** | èµ„æºä½¿ç”¨ã€å¹¶å‘é‡ | ä¼˜åŒ–å­˜å‚¨ã€è´Ÿè½½å‡è¡¡ | æ€§èƒ½æµ‹è¯•ã€å®¹é‡è§„åˆ’ |
| **å®‰å…¨é—®é¢˜** | IPéªŒè¯ã€ä¼ è¾“åŠ å¯† | å¼ºåŒ–éªŒè¯ã€HTTPS | å®‰å…¨å®¡è®¡ã€æ¼æ´æ‰«æ |

### 7.2 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ å¼€å‘é˜¶æ®µæœ€ä½³å®è·µï¼š**
- ğŸ“ **å®Œå–„æ—¥å¿—**ï¼šè®°å½•Sessionç”Ÿå‘½å‘¨æœŸçš„å…³é”®äº‹ä»¶
- ğŸ”§ **å·¥å…·å‡†å¤‡**ï¼šå‡†å¤‡è°ƒè¯•å·¥å…·å’Œç›‘æ§è„šæœ¬
- ğŸ“‹ **æ–‡æ¡£ç»´æŠ¤**ï¼šè®°å½•é…ç½®å‚æ•°å’Œæ’æŸ¥æ­¥éª¤
- ğŸ§ª **æµ‹è¯•éªŒè¯**ï¼šæ¨¡æ‹Ÿå„ç§æ•…éšœåœºæ™¯è¿›è¡Œæµ‹è¯•

**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µï¼š**
```
ç›‘æ§å‘Šè­¦ä½“ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸš¨ å®æ—¶å‘Šè­¦                         â”‚
â”‚   â€¢ Sessionåˆ›å»ºå¤±è´¥ç‡ > 1%          â”‚
â”‚   â€¢ å¹³å‡å“åº”æ—¶é—´ > 3ç§’              â”‚
â”‚   â€¢ æ´»è·ƒSessionæ•°å¼‚å¸¸å¢é•¿            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š å®šæœŸæŠ¥å‘Š                         â”‚  
â”‚   â€¢ æ¯æ—¥Sessionç»Ÿè®¡æŠ¥å‘Š             â”‚
â”‚   â€¢ æ¯å‘¨æ€§èƒ½è¶‹åŠ¿åˆ†æ                â”‚
â”‚   â€¢ æ¯æœˆæ•…éšœæ€»ç»“å›é¡¾                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 åº”æ€¥å¤„ç†æµç¨‹


**ğŸš‘ æ•…éšœåº”æ€¥å“åº”ï¼š**
```java
// å¿«é€Ÿåº”æ€¥å¤„ç†ä»£ç æ¨¡æ¿
public class EmergencySessionFix {
    
    // 1. ä¸´æ—¶å»¶é•¿æ‰€æœ‰Sessionè¶…æ—¶æ—¶é—´
    public void extendAllSessionTimeout(int minutes) {
        // å…·ä½“å®ç°å–å†³äºSessionç®¡ç†å™¨
        // ä¾‹å¦‚ï¼šè°ƒæ•´Tomcat Managerçš„å…¨å±€è¶…æ—¶è®¾ç½®
    }
    
    // 2. æ¸…ç†å¼‚å¸¸Sessionæ•°æ®
    public void cleanupCorruptedSessions() {
        // è¯†åˆ«å¹¶æ¸…ç†æ— æ•ˆçš„Sessionæ•°æ®
        // æ³¨æ„ï¼šè¿™ä¸ªæ“ä½œè¦è°¨æ…ï¼Œé¿å…å½±å“æ­£å¸¸ç”¨æˆ·
    }
    
    // 3. åˆ‡æ¢åˆ°å¤‡ç”¨Sessionå­˜å‚¨
    public void switchToBackupStorage() {
        // åœ¨ä¸»å­˜å‚¨æ•…éšœæ—¶åˆ‡æ¢åˆ°å¤‡ç”¨æ–¹æ¡ˆ
        // ä¾‹å¦‚ï¼šä»Redisåˆ‡æ¢åˆ°æ•°æ®åº“å­˜å‚¨
    }
}
```

**ğŸ”„ æ•…éšœæ¢å¤æµç¨‹ï¼š**
```
æ¢å¤æ­¥éª¤æ¸…å•ï¼š
â–¡ 1. ç¡®è®¤æ•…éšœå·²è§£å†³
â–¡ 2. é€æ­¥æ¢å¤æ­£å¸¸é…ç½®  
â–¡ 3. ç›‘æ§ç³»ç»ŸçŠ¶æ€ç¨³å®šæ€§
â–¡ 4. é€šçŸ¥ç”¨æˆ·æœåŠ¡æ¢å¤
â–¡ 5. æ’°å†™æ•…éšœåˆ†ææŠ¥å‘Š
â–¡ 6. åˆ¶å®šé¢„é˜²æ”¹è¿›æªæ–½
```

### 7.4 å­¦ä¹ å»ºè®®


**ğŸ“š æŠ€èƒ½æå‡è·¯å¾„ï¼š**
```
åŸºç¡€æŠ€èƒ½ï¼š
â€¢ ç†Ÿç»ƒä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·
â€¢ ç†è§£HTTPåè®®å’ŒCookieæœºåˆ¶  
â€¢ æŒæ¡WebæœåŠ¡å™¨é…ç½®

è¿›é˜¶æŠ€èƒ½ï¼š
â€¢ å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„
â€¢ äº†è§£ç¼“å­˜å’Œå­˜å‚¨æŠ€æœ¯
â€¢ æŒæ¡æ€§èƒ½åˆ†æå’Œè°ƒä¼˜

ä¸“å®¶æŠ€èƒ½ï¼š
â€¢ ç²¾é€šç½‘ç»œå®‰å…¨é˜²æŠ¤
â€¢ å…·å¤‡å¤§è§„æ¨¡ç³»ç»Ÿè®¾è®¡èƒ½åŠ›
â€¢ èƒ½å¤Ÿåˆ¶å®šæŠ€æœ¯æ ‡å‡†å’Œè§„èŒƒ
```

**æ ¸å¿ƒè®°å¿†ï¼š**
- æ’æŸ¥æ•…éšœè¦ç³»ç»Ÿæ€§ï¼Œä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨é€å±‚æ£€æŸ¥
- æ€§èƒ½é—®é¢˜å¤šå…³æ³¨èµ„æºä½¿ç”¨å’Œå¹¶å‘å¤„ç†èƒ½åŠ›  
- å®‰å…¨é—®é¢˜éœ€è¦å¤šå±‚é˜²æŠ¤ï¼Œé˜²æ­¢SessionåŠ«æŒ
- é›†ç¾¤ç¯å¢ƒé‡ç‚¹å…³æ³¨æ•°æ®ä¸€è‡´æ€§å’Œè´Ÿè½½å‡è¡¡
- å»ºç«‹å®Œå–„çš„ç›‘æ§å‘Šè­¦æœºåˆ¶ï¼ŒåŠæ—©å‘ç°é—®é¢˜
- å‡†å¤‡åº”æ€¥å¤„ç†æ–¹æ¡ˆï¼Œå¿«é€Ÿå“åº”ç”Ÿäº§æ•…éšœ