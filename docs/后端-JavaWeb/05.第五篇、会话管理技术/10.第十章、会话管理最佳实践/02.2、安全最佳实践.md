---
title: 2ã€å®‰å…¨æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [ä¼šè¯å®‰å…¨åŸºæœ¬æ¦‚å¿µ](#1-ä¼šè¯å®‰å…¨åŸºæœ¬æ¦‚å¿µ)
2. [HTTPSå¼ºåˆ¶ä¼ è¾“](#2-HTTPSå¼ºåˆ¶ä¼ è¾“)
3. [SessionIDå®‰å…¨ç”Ÿæˆ](#3-SessionIDå®‰å…¨ç”Ÿæˆ)
4. [æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ç­–ç•¥](#4-æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ç­–ç•¥)
5. [å®šæœŸSessionIDæ›´æ–°æœºåˆ¶](#5-å®šæœŸSessionIDæ›´æ–°æœºåˆ¶)
6. [å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•](#6-å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä¼šè¯å®‰å…¨åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ä¼šè¯å®‰å…¨


**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
æƒ³è±¡ä½ åœ¨é“¶è¡ŒåŠä¸šåŠ¡ï¼š
â€¢ èº«ä»½éªŒè¯ï¼šå‡ºç¤ºèº«ä»½è¯è¯æ˜ä½ æ˜¯ä½ 
â€¢ ä¸šåŠ¡å‡­è¯ï¼šæ‹¿åˆ°ä¸€ä¸ªå·ç ç‰Œ
â€¢ å®‰å…¨ä¿éšœï¼šå·ç ç‰Œä¸èƒ½è¢«åˆ«äººå†’ç”¨
â€¢ å®šæœŸæ›´æ–°ï¼šè¶…æ—¶åéœ€è¦é‡æ–°å–å·

JavaWebä¼šè¯å®‰å…¨å°±æ˜¯è¿™æ ·ä¿æŠ¤ç”¨æˆ·èº«ä»½çš„ï¼
```

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
ä¼šè¯å®‰å…¨æ˜¯æŒ‡ä¿æŠ¤ç”¨æˆ·åœ¨ç½‘ç«™ä¸Šçš„èº«ä»½ä¿¡æ¯ï¼Œé˜²æ­¢ä¼šè¯è¢«åŠ«æŒã€ä¼ªé€ æˆ–æ¶æ„åˆ©ç”¨çš„æŠ€æœ¯å’Œç­–ç•¥ã€‚

### 1.2 å¸¸è§çš„ä¼šè¯å®‰å…¨å¨èƒ


**âš ï¸ ä¸»è¦å®‰å…¨é£é™©**

| å¨èƒç±»å‹ | **ç®€å•è§£é‡Š** | **å±å®³ç¨‹åº¦** | **æ”»å‡»åœºæ™¯** |
|---------|------------|-------------|-------------|
| **ä¼šè¯åŠ«æŒ** | `é»‘å®¢å·èµ°ä½ çš„SessionID` | ğŸ”´ æé«˜ | `å…¬å…±WiFiç¯å¢ƒä¸‹çš„æ•°æ®çªƒå–` |
| **ä¼šè¯å›ºå®š** | `é»‘å®¢æå‰è®¾ç½®å¥½SessionID` | ğŸŸ¡ ä¸­ç­‰ | `é’“é±¼ç½‘ç«™è¯±å¯¼ç‚¹å‡»` |
| **è·¨ç«™è¯·æ±‚ä¼ªé€ ** | `å†’å……ç”¨æˆ·æ‰§è¡Œæ“ä½œ` | ğŸ”´ æé«˜ | `æ¶æ„ç½‘ç«™å‘èµ·è½¬è´¦è¯·æ±‚` |
| **ä¿¡æ¯æ³„éœ²** | `æ•æ„Ÿæ•°æ®è¢«çªƒå–` | ğŸŸ  é«˜ | `Sessionä¸­å­˜å‚¨å¯†ç ç­‰ä¿¡æ¯` |

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨æœ€ä½³å®è·µ


**ğŸ¯ ä¿æŠ¤ç›®æ ‡**
- **ç”¨æˆ·éšç§**ï¼šé˜²æ­¢ä¸ªäººä¿¡æ¯æ³„éœ²
- **èµ„äº§å®‰å…¨**ï¼šé˜²æ­¢è´¦æˆ·è¢«ç›—ç”¨
- **ç³»ç»Ÿå®Œæ•´æ€§**ï¼šç»´æŠ¤åº”ç”¨æ­£å¸¸è¿è¡Œ
- **æ³•å¾‹åˆè§„**ï¼šæ»¡è¶³æ•°æ®ä¿æŠ¤æ³•è§„è¦æ±‚

---

## 2. ğŸ”’ HTTPSå¼ºåˆ¶ä¼ è¾“


### 2.1 HTTPSçš„é‡è¦æ€§


**ğŸ’¡ æ ¸å¿ƒç†è§£**
```
HTTPä¼ è¾“ = æ˜ä¿¡ç‰‡
â€¢ å†…å®¹å®Œå…¨æš´éœ²ï¼Œä»»ä½•äººéƒ½èƒ½çœ‹åˆ°
â€¢ SessionIDåƒå†™åœ¨æ˜ä¿¡ç‰‡ä¸Šçš„å¯†ç 

HTTPSä¼ è¾“ = ä¿é™©ç®±
â€¢ å†…å®¹åŠ å¯†ä¿æŠ¤ï¼Œåªæœ‰æ”¶ä»¶äººèƒ½æ‰“å¼€
â€¢ SessionIDå®‰å…¨ä¼ é€’ï¼Œé»‘å®¢æ— æ³•çªƒå–
```

**ğŸ”¸ HTTPSä¿æŠ¤æœºåˆ¶**
- **æ•°æ®åŠ å¯†**ï¼šä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®è¢«åŠ å¯†ï¼Œæ— æ³•è¢«ä¸­é—´äººè¯»å–
- **èº«ä»½éªŒè¯**ï¼šç¡®è®¤æœåŠ¡å™¨èº«ä»½ï¼Œé˜²æ­¢é’“é±¼ç½‘ç«™
- **å®Œæ•´æ€§æ ¡éªŒ**ï¼šæ£€æµ‹æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹

### 2.2 å¼ºåˆ¶HTTPSé…ç½®


**ğŸ”§ Spring Booté…ç½®ç¤ºä¾‹**
```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            // å¼ºåˆ¶HTTPS
            .requiresChannel(channel -> 
                channel.anyRequest().requiresSecure())
            
            // è®¾ç½®HSTSå¤´
            .headers(headers -> headers
                .httpStrictTransportSecurity(hsts -> hsts
                    .maxAgeInSeconds(31536000) // 1å¹´
                    .includeSubdomains(true)))
            
            // Sessionå®‰å…¨é…ç½®
            .sessionManagement(session -> session
                .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)
                .maximumSessions(1)
                .maxSessionsPreventsLogin(false));
        
        return http.build();
    }
}
```

**ğŸ“‹ é…ç½®è¯´æ˜**
- `requiresSecure()`ï¼šå¼ºåˆ¶ä½¿ç”¨HTTPSåè®®
- `httpStrictTransportSecurity`ï¼šå‘Šè¯‰æµè§ˆå™¨åªèƒ½ç”¨HTTPSè®¿é—®
- `maxAgeInSeconds`ï¼šHSTSç­–ç•¥æœ‰æ•ˆæ—¶é—´
- `includeSubdomains`ï¼šåŒ…å«æ‰€æœ‰å­åŸŸå

### 2.3 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥


**ğŸ” éƒ¨ç½²æ£€æŸ¥æ¸…å•**
- [ ] SSLè¯ä¹¦æœ‰æ•ˆä¸”æœªè¿‡æœŸ
- [ ] HTTPè¯·æ±‚è‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- [ ] ç§»é™¤æ‰€æœ‰HTTPç«¯å£ç›‘å¬
- [ ] é…ç½®HSTSå“åº”å¤´
- [ ] ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•ï¼ˆTLS 1.2+ï¼‰

---

## 3. ğŸ² SessionIDå®‰å…¨ç”Ÿæˆ


### 3.1 SessionIDç”ŸæˆåŸç†


**ğŸ§  ä¸ºä»€ä¹ˆè¦å®‰å…¨ç”Ÿæˆ**
```
ä¸å®‰å…¨çš„SessionIDï¼š
JSESSIONID=USER001, USER002, USER003...
â†“
é»‘å®¢å¾ˆå®¹æ˜“çŒœåˆ°ï¼šUSER004, USER005...

å®‰å…¨çš„SessionIDï¼š
JSESSIONID=A8F2E7B4C9D6H3L5...
â†“
å®Œå…¨éšæœºï¼Œæ— æ³•é¢„æµ‹å’Œä¼ªé€ 
```

### 3.2 å®‰å…¨SessionIDç‰¹å¾


**âœ… å®‰å…¨SessionIDè¦æ±‚**
- **è¶³å¤Ÿé•¿åº¦**ï¼šè‡³å°‘128ä½ï¼ˆ16å­—èŠ‚ï¼‰
- **çœŸéšæœºæ€§**ï¼šä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
- **ä¸å¯é¢„æµ‹**ï¼šæ— æ³•é€šè¿‡ç®—æ³•æ¨ç®—å‡ºä¸‹ä¸€ä¸ªID
- **å”¯ä¸€æ€§**ï¼šåŒä¸€æ—¶é—´å†…ä¸èƒ½é‡å¤

### 3.3 è‡ªå®šä¹‰å®‰å…¨SessionIDç”Ÿæˆ


```java
@Component
public class SecureSessionIdGenerator {
    
    private static final SecureRandom secureRandom = new SecureRandom();
    private static final int SESSION_ID_LENGTH = 32; // 32å­—èŠ‚ = 256ä½
    
    /**
     * ç”Ÿæˆå®‰å…¨çš„SessionID
     */
    public String generateSecureSessionId() {
        byte[] randomBytes = new byte[SESSION_ID_LENGTH];
        secureRandom.nextBytes(randomBytes);
        
        // è½¬æ¢ä¸ºBase64ç¼–ç ï¼ŒURLå®‰å…¨
        return Base64.getUrlEncoder()
                    .withoutPadding()
                    .encodeToString(randomBytes);
    }
    
    /**
     * éªŒè¯SessionIDæ ¼å¼
     */
    public boolean isValidSessionId(String sessionId) {
        if (sessionId == null || sessionId.length() < 40) {
            return false;
        }
        
        // åªåŒ…å«Base64URLå­—ç¬¦
        return sessionId.matches("[A-Za-z0-9_-]+");
    }
}
```

**ğŸ“Œ ä»£ç è§£æ**
- `SecureRandom`ï¼šä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
- `SESSION_ID_LENGTH = 32`ï¼šç”Ÿæˆ32å­—èŠ‚çš„éšæœºæ•°æ®
- `Base64.getUrlEncoder()`ï¼šç¼–ç ä¸ºURLå®‰å…¨çš„å­—ç¬¦ä¸²
- `isValidSessionId()`ï¼šéªŒè¯SessionIDæ ¼å¼çš„åˆæ³•æ€§

### 3.4 å®¹å™¨çº§åˆ«é…ç½®


**ğŸ”§ Tomcaté…ç½®ä¼˜åŒ–**
```xml
<!-- server.xmlé…ç½® -->
<Context>
    <!-- ä½¿ç”¨å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ -->
    <Manager className="org.apache.catalina.session.StandardManager"
             randomClass="java.security.SecureRandom"
             entropy="SHA1PRNG" />
             
    <!-- SessionIDé•¿åº¦è®¾ç½® -->
    <SessionCookie httpOnly="true" secure="true" />
</Context>
```

---

## 4. ğŸ›¡ï¸ æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ç­–ç•¥


### 4.1 æ•æ„Ÿä¿¡æ¯åˆ†ç±»


**ğŸ“Š ä¿¡æ¯æ•æ„Ÿåº¦åˆ†çº§**
```
ğŸ”´ ç»å¯¹ä¸èƒ½å­˜å‚¨ï¼š
â€¢ ç”¨æˆ·å¯†ç ï¼ˆåŸå§‹å¯†ç ï¼‰
â€¢ é“¶è¡Œå¡å·ã€èº«ä»½è¯å·
â€¢ æ”¯ä»˜å¯†é’¥ã€ç§é’¥

ğŸŸ¡ è°¨æ…å­˜å‚¨ï¼š
â€¢ ç”¨æˆ·çœŸå®å§“å
â€¢ æ‰‹æœºå·ã€é‚®ç®±
â€¢ åœ°å€ä¿¡æ¯

ğŸŸ¢ å¯ä»¥å­˜å‚¨ï¼š
â€¢ ç”¨æˆ·ID
â€¢ ç”¨æˆ·è§’è‰²
â€¢ ç³»ç»Ÿé…ç½®ä¿¡æ¯
```

### 4.2 Sessionæ•°æ®å­˜å‚¨åŸåˆ™


**ğŸ’¡ æœ€ä½³å®è·µåŸåˆ™**

> **ğŸ”’ æœ€å°åŒ–åŸåˆ™**ï¼šåªå­˜å‚¨å¿…éœ€çš„ä¿¡æ¯ï¼Œèƒ½ä¸å­˜å‚¨å°±ä¸å­˜å‚¨

> **â±ï¸ æ—¶æ•ˆæ€§åŸåˆ™**ï¼šæ•æ„Ÿä¿¡æ¯è®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´

> **ğŸ” åŠ å¯†åŸåˆ™**ï¼šå¿…è¦æ—¶å¯¹æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†å­˜å‚¨

### 4.3 å®‰å…¨çš„Sessionæ•°æ®ç®¡ç†


```java
@Service
public class SecureSessionService {
    
    private final RedisTemplate<String, Object> redisTemplate;
    private final AESUtil aesUtil; // åŠ å¯†å·¥å…·ç±»
    
    /**
     * å®‰å…¨å­˜å‚¨ç”¨æˆ·ä¿¡æ¯åˆ°Session
     */
    public void storeUserInfo(HttpSession session, User user) {
        // åªå­˜å‚¨å¿…è¦ä¿¡æ¯
        SessionUserInfo sessionUser = SessionUserInfo.builder()
            .userId(user.getId())
            .username(user.getUsername())
            .roles(user.getRoles())
            .loginTime(LocalDateTime.now())
            .build();
            
        // æ•æ„Ÿä¿¡æ¯å•ç‹¬å¤„ç†
        if (user.getPhoneNumber() != null) {
            String encryptedPhone = aesUtil.encrypt(user.getPhoneNumber());
            sessionUser.setEncryptedPhone(encryptedPhone);
        }
        
        session.setAttribute("userInfo", sessionUser);
        
        // è®¾ç½®Sessionè¶…æ—¶æ—¶é—´ï¼ˆ30åˆ†é’Ÿï¼‰
        session.setMaxInactiveInterval(30 * 60);
    }
    
    /**
     * å®‰å…¨è·å–ç”¨æˆ·ä¿¡æ¯
     */
    public SessionUserInfo getUserInfo(HttpSession session) {
        SessionUserInfo userInfo = (SessionUserInfo) session.getAttribute("userInfo");
        
        if (userInfo != null && userInfo.getEncryptedPhone() != null) {
            // è§£å¯†æ•æ„Ÿä¿¡æ¯
            String phoneNumber = aesUtil.decrypt(userInfo.getEncryptedPhone());
            userInfo.setPhoneNumber(phoneNumber);
        }
        
        return userInfo;
    }
    
    /**
     * æ¸…ç†æ•æ„Ÿä¿¡æ¯
     */
    public void cleanSensitiveInfo(HttpSession session) {
        SessionUserInfo userInfo = (SessionUserInfo) session.getAttribute("userInfo");
        if (userInfo != null) {
            // æ¸…é™¤è§£å¯†åçš„æ•æ„Ÿä¿¡æ¯
            userInfo.setPhoneNumber(null);
            session.setAttribute("userInfo", userInfo);
        }
    }
}
```

### 4.4 æ•°æ®è„±æ•ç­–ç•¥


**ğŸ­ å¸¸ç”¨è„±æ•æ–¹æ³•**

| æ•°æ®ç±»å‹ | **è„±æ•è§„åˆ™** | **ç¤ºä¾‹** |
|---------|------------|---------|
| **æ‰‹æœºå·** | `ä¸­é—´4ä½*å·` | `138****5678` |
| **èº«ä»½è¯** | `ä¸­é—´10ä½*å·` | `320101****1234567X` |
| **é“¶è¡Œå¡** | `ä¸­é—´8ä½*å·` | `6222****5678` |
| **é‚®ç®±** | `@å‰2ä½å*å·` | `zh**@example.com` |

---

## 5. ğŸ”„ å®šæœŸSessionIDæ›´æ–°æœºåˆ¶


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦å®šæœŸæ›´æ–°


**ğŸ’­ å®‰å…¨ç±»æ¯”**
```
å°±åƒå®šæœŸæ›´æ¢é—¨é”ï¼š
â€¢ é˜²æ­¢é’¥åŒ™è¢«å¤åˆ¶ï¼šSessionIDè¢«çªƒå–
â€¢ é™ä½å®‰å…¨é£é™©ï¼šå³ä½¿æ³„éœ²ä¹Ÿä¼šå¤±æ•ˆ
â€¢ æé«˜å®‰å…¨ç­‰çº§ï¼šæ”»å‡»çª—å£æœŸå¾ˆçŸ­

SessionIDå®šæœŸæ›´æ–°çš„å¥½å¤„ï¼š
â€¢ é˜²æ­¢é•¿æœŸä¼šè¯åŠ«æŒ
â€¢ é™ä½SessionIDè¢«ç ´è§£é£é™©
â€¢ ç¬¦åˆå®‰å…¨è§„èŒƒè¦æ±‚
```

### 5.2 æ›´æ–°è§¦å‘æ¡ä»¶


**âš¡ è‡ªåŠ¨æ›´æ–°åœºæ™¯**
- **æƒé™æå‡**ï¼šæ™®é€šç”¨æˆ·å‡çº§ä¸ºç®¡ç†å‘˜
- **æ•æ„Ÿæ“ä½œ**ï¼šä¿®æ”¹å¯†ç ã€æ”¯ä»˜æ“ä½œ
- **å®šæ—¶æ›´æ–°**ï¼šæ¯30åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°
- **å¼‚å¸¸æ£€æµ‹**ï¼šå‘ç°å¯ç–‘è®¿é—®è¡Œä¸º

### 5.3 SessionIDæ›´æ–°å®ç°


```java
@Component
public class SessionIdRegenerator {
    
    private final HttpSessionEventPublisher sessionEventPublisher;
    
    /**
     * é‡æ–°ç”ŸæˆSessionID
     */
    public String regenerateSessionId(HttpServletRequest request) {
        HttpSession oldSession = request.getSession(false);
        if (oldSession == null) {
            return null;
        }
        
        // ä¿å­˜æ—§Sessionçš„æ•°æ®
        Map<String, Object> sessionData = new HashMap<>();
        Enumeration<String> attributeNames = oldSession.getAttributeNames();
        while (attributeNames.hasMoreElements()) {
            String attributeName = attributeNames.nextElement();
            sessionData.put(attributeName, oldSession.getAttribute(attributeName));
        }
        
        // é”€æ¯æ—§Session
        oldSession.invalidate();
        
        // åˆ›å»ºæ–°Session
        HttpSession newSession = request.getSession(true);
        
        // æ¢å¤Sessionæ•°æ®
        for (Map.Entry<String, Object> entry : sessionData.entrySet()) {
            newSession.setAttribute(entry.getKey(), entry.getValue());
        }
        
        // è®°å½•SessionIDæ›´æ–°æ—¥å¿—
        logSessionIdRegeneration(oldSession.getId(), newSession.getId());
        
        return newSession.getId();
    }
    
    /**
     * æ•æ„Ÿæ“ä½œæ—¶è‡ªåŠ¨æ›´æ–°
     */
    @EventListener
    public void handleSensitiveOperation(SensitiveOperationEvent event) {
        HttpServletRequest request = event.getRequest();
        
        // æƒé™æå‡æ—¶æ›´æ–°SessionID
        if (event.getOperationType() == OperationType.PRIVILEGE_ELEVATION) {
            regenerateSessionId(request);
        }
        
        // å¯†ç ä¿®æ”¹æ—¶æ›´æ–°SessionID  
        if (event.getOperationType() == OperationType.PASSWORD_CHANGE) {
            regenerateSessionId(request);
        }
    }
    
    private void logSessionIdRegeneration(String oldSessionId, String newSessionId) {
        log.info("SessionIDæ›´æ–°: {} -> {}", 
                maskSessionId(oldSessionId), 
                maskSessionId(newSessionId));
    }
    
    private String maskSessionId(String sessionId) {
        if (sessionId == null || sessionId.length() < 8) {
            return "****";
        }
        return sessionId.substring(0, 4) + "****" + sessionId.substring(sessionId.length() - 4);
    }
}
```

### 5.4 å®šæ—¶æ›´æ–°ç­–ç•¥


```java
@Component
public class ScheduledSessionUpdater {
    
    @Autowired
    private SessionRegistry sessionRegistry;
    
    /**
     * æ¯30åˆ†é’Ÿæ£€æŸ¥å¹¶æ›´æ–°æ´»è·ƒSession
     */
    @Scheduled(fixedRate = 30 * 60 * 1000) // 30åˆ†é’Ÿ
    public void updateActiveSessions() {
        List<SessionInformation> allSessions = sessionRegistry.getAllSessions(null, false);
        
        for (SessionInformation sessionInfo : allSessions) {
            // æ£€æŸ¥Sessionæ´»è·ƒæ—¶é—´
            if (shouldRegenerateSession(sessionInfo)) {
                // é€šçŸ¥å®¢æˆ·ç«¯æ›´æ–°SessionID
                notifySessionIdUpdate(sessionInfo.getSessionId());
            }
        }
    }
    
    private boolean shouldRegenerateSession(SessionInformation sessionInfo) {
        long lastRequestTime = sessionInfo.getLastRequest().getTime();
        long currentTime = System.currentTimeMillis();
        
        // è¶…è¿‡30åˆ†é’Ÿæœªæ›´æ–°ä¸”ä»ç„¶æ´»è·ƒ
        return (currentTime - lastRequestTime) > (30 * 60 * 1000);
    }
}
```

---

## 6. âœ… å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•


### 6.1 Sessioné…ç½®æ£€æŸ¥


**ğŸ“‹ å¿…æ£€é¡¹ç›®æ¸…å•**
```
ğŸ” åŸºç¡€é…ç½®æ£€æŸ¥
- [ ] Sessionè¶…æ—¶æ—¶é—´åˆç†ï¼ˆ15-30åˆ†é’Ÿï¼‰
- [ ] SessionIDç”Ÿæˆä½¿ç”¨å®‰å…¨éšæœºæ•°
- [ ] å¯ç”¨HttpOnly cookie
- [ ] å¯ç”¨Secure cookieï¼ˆHTTPSç¯å¢ƒï¼‰
- [ ] ç¦ç”¨URLé‡å†™ä¼ é€’SessionID

ğŸ” å®‰å…¨ç­–ç•¥æ£€æŸ¥  
- [ ] å¼ºåˆ¶HTTPSä¼ è¾“
- [ ] é…ç½®HSTSå“åº”å¤´
- [ ] å®ç°Sessionå›ºå®šä¿æŠ¤
- [ ] è®¾ç½®åŒæºç­–ç•¥
- [ ] å¯ç”¨CSRFä¿æŠ¤
```

### 6.2 Spring Securityé…ç½®æ¨¡æ¿


```java
@Configuration
@EnableWebSecurity
public class WebSecurityConfig {
    
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        return http
            // Sessionç®¡ç†é…ç½®
            .sessionManagement(session -> session
                // Sessionåˆ›å»ºç­–ç•¥
                .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)
                
                // æœ€å¤§å¹¶å‘Sessionæ•°
                .maximumSessions(1)
                .maxSessionsPreventsLogin(false)
                .sessionRegistry(sessionRegistry())
                
                // Sessionå›ºå®šä¿æŠ¤
                .and()
                .sessionFixation().migrateSession()
                
                // æ— æ•ˆSessionå¤„ç†
                .invalidSessionUrl("/login?expired")
            )
            
            // Cookieå®‰å…¨é…ç½®
            .headers(headers -> headers
                .frameOptions().deny()
                .contentTypeOptions().and()
                .httpStrictTransportSecurity(hsts -> hsts
                    .maxAgeInSeconds(31536000)
                    .includeSubdomains(true)
                )
            )
            
            // CSRFä¿æŠ¤
            .csrf(csrf -> csrf
                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())
            )
            
            .build();
    }
    
    @Bean
    public SessionRegistry sessionRegistry() {
        return new SessionRegistryImpl();
    }
}
```

### 6.3 ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æµ‹è„šæœ¬


```java
@Component
@ConditionalOnProperty(name = "security.audit.enabled", havingValue = "true")
public class SecurityAuditService {
    
    /**
     * å®‰å…¨é…ç½®è‡ªæ£€
     */
    @EventListener(ApplicationReadyEvent.class)
    public void performSecurityAudit() {
        List<String> issues = new ArrayList<>();
        
        // æ£€æŸ¥HTTPSé…ç½®
        if (!isHttpsEnforced()) {
            issues.add("HTTPSæœªå¼ºåˆ¶å¯ç”¨");
        }
        
        // æ£€æŸ¥Sessioné…ç½®
        if (!isSecureSessionConfig()) {
            issues.add("Sessionå®‰å…¨é…ç½®ä¸å®Œæ•´");
        }
        
        // æ£€æŸ¥Cookieå®‰å…¨
        if (!isSecureCookieConfig()) {
            issues.add("Cookieå®‰å…¨é…ç½®ä¸å®Œæ•´");
        }
        
        // è¾“å‡ºæ£€æŸ¥ç»“æœ
        if (issues.isEmpty()) {
            log.info("âœ… å®‰å…¨é…ç½®æ£€æŸ¥é€šè¿‡");
        } else {
            log.warn("âš ï¸ å‘ç°å®‰å…¨é…ç½®é—®é¢˜: {}", String.join(", ", issues));
        }
    }
    
    private boolean isHttpsEnforced() {
        // æ£€æŸ¥æ˜¯å¦å¼ºåˆ¶HTTPS
        return true; // å®é™…å®ç°æ£€æŸ¥é€»è¾‘
    }
    
    private boolean isSecureSessionConfig() {
        // æ£€æŸ¥Sessionå®‰å…¨é…ç½®
        return true; // å®é™…å®ç°æ£€æŸ¥é€»è¾‘
    }
    
    private boolean isSecureCookieConfig() {
        // æ£€æŸ¥Cookieå®‰å…¨é…ç½®  
        return true; // å®é™…å®ç°æ£€æŸ¥é€»è¾‘
    }
}
```

### 6.4 è¿ç»´ç›‘æ§æŒ‡æ ‡


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**

| æŒ‡æ ‡ç±»å‹ | **ç›‘æ§é¡¹** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|---------|-----------|-------------|-------------|
| **Sessionå®‰å…¨** | `HTTPSè®¿é—®ç‡` | `> 99%` | `< 95%` |
| **Sessionè´¨é‡** | `å¹³å‡Sessionæ—¶é•¿` | `5-30åˆ†é’Ÿ` | `> 2å°æ—¶` |
| **å¼‚å¸¸æ£€æµ‹** | `SessionåŠ«æŒå°è¯•` | `0æ¬¡/å¤©` | `> 5æ¬¡/å¤©` |
| **æ€§èƒ½æŒ‡æ ‡** | `Sessionåˆ›å»ºé€Ÿç‡` | `< 100/ç§’` | `> 500/ç§’` |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ HTTPSä¼ è¾“ï¼šæ‰€æœ‰Sessionç›¸å…³æ•°æ®å¿…é¡»åŠ å¯†ä¼ è¾“
ğŸ”¸ å®‰å…¨SessionIDï¼šä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
ğŸ”¸ æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ï¼šæœ€å°åŒ–å­˜å‚¨ï¼Œå¿…è¦æ—¶åŠ å¯†
ğŸ”¸ å®šæœŸæ›´æ–°ï¼šæ•æ„Ÿæ“ä½œå’Œå®šæ—¶è§¦å‘SessionIDæ›´æ–°
ğŸ”¸ å®‰å…¨é…ç½®ï¼šHttpOnlyã€Secureã€CSRFä¿æŠ¤ç­‰
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®‰å…¨é˜²æŠ¤çš„å±‚æ¬¡æ€§**
```
ä¼ è¾“å±‚å®‰å…¨ï¼š
HTTPS + HSTS â†’ é˜²æ­¢æ•°æ®ä¼ è¾“è¢«çªƒå¬

åº”ç”¨å±‚å®‰å…¨ï¼š
Sessioné…ç½® + CSRFä¿æŠ¤ â†’ é˜²æ­¢åº”ç”¨å±‚æ”»å‡»

æ•°æ®å±‚å®‰å…¨ï¼š
æ•æ„Ÿä¿¡æ¯åŠ å¯† + æœ€å°åŒ–å­˜å‚¨ â†’ é˜²æ­¢æ•°æ®æ³„éœ²
```

**ğŸ”¹ å®‰å…¨ä¸ç”¨æˆ·ä½“éªŒçš„å¹³è¡¡**
```
å®‰å…¨æªæ–½è¶Šä¸¥æ ¼ â†â†’ ç”¨æˆ·ä½“éªŒè¶Šå¤æ‚
â€¢ é¢‘ç¹æ›´æ–°SessionIDï¼šå®‰å…¨â†‘ ä½“éªŒâ†“
â€¢ é•¿Sessionè¶…æ—¶ï¼šå®‰å…¨â†“ ä½“éªŒâ†‘
â€¢ æœ€ä½³å®è·µï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯å¹³è¡¡é…ç½®
```

**ğŸ”¹ æŒç»­å®‰å…¨çš„é‡è¦æ€§**
```
å®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§é…ç½®ï¼š
â€¢ å®šæœŸå®‰å…¨å®¡è®¡
â€¢ ç›‘æ§å¼‚å¸¸è¡Œä¸º  
â€¢ åŠæ—¶æ›´æ–°å®‰å…¨ç­–ç•¥
â€¢ è·Ÿè¸ªæœ€æ–°å®‰å…¨å¨èƒ
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä¸åŒåœºæ™¯çš„å®‰å…¨ç­–ç•¥**

```
ğŸ’° é‡‘èçº§åº”ç”¨ï¼ˆæé«˜å®‰å…¨ï¼‰ï¼š
â€¢ Sessionè¶…æ—¶ï¼š15åˆ†é’Ÿ
â€¢ æ•æ„Ÿæ“ä½œå¿…é¡»é‡æ–°éªŒè¯
â€¢ å¼ºåˆ¶å®šæœŸæ›´æ–°SessionID
â€¢ å¤šå› ç´ èº«ä»½éªŒè¯

ğŸ¢ ä¼ä¸šçº§åº”ç”¨ï¼ˆé«˜å®‰å…¨ï¼‰ï¼š
â€¢ Sessionè¶…æ—¶ï¼š30åˆ†é’Ÿ  
â€¢ æƒé™å˜æ›´æ—¶æ›´æ–°SessionID
â€¢ æ•æ„Ÿä¿¡æ¯åˆ†çº§ä¿æŠ¤
â€¢ å®Œæ•´çš„å®¡è®¡æ—¥å¿—

ğŸ“± ä¸€èˆ¬Webåº”ç”¨ï¼ˆæ ‡å‡†å®‰å…¨ï¼‰ï¼š
â€¢ Sessionè¶…æ—¶ï¼š60åˆ†é’Ÿ
â€¢ åŸºç¡€å®‰å…¨é…ç½®
â€¢ å…³é”®æ“ä½œç¡®è®¤
â€¢ åŸºæœ¬ç›‘æ§å‘Šè­¦
```

### 7.4 å®‰å…¨æ£€æŸ¥å¿«é€Ÿå£è¯€


**ğŸ§  è®°å¿†å£è¯€**
```
"HTTPSå¿…é¡»æœ‰ï¼ŒSessionIDè¦å®‰å…¨ï¼Œ
æ•æ„Ÿä¿¡æ¯åˆ«ä¹±æ”¾ï¼Œå®šæœŸæ›´æ–°ä¸èƒ½å¿˜ï¼Œ
é…ç½®æ£€æŸ¥è¦ä»”ç»†ï¼Œç›‘æ§å‘Šè­¦ä¿å¹³å®‰"
```

**ğŸ“Œ æ—¥å¸¸æ£€æŸ¥è¦ç‚¹**
- æ¯æ¬¡éƒ¨ç½²å‰ï¼šè¿è¡Œå®‰å…¨é…ç½®æ£€æŸ¥
- æ¯å‘¨ä¸€æ¬¡ï¼šæŸ¥çœ‹å®‰å…¨ç›‘æ§æŠ¥å‘Š
- æ¯æœˆä¸€æ¬¡ï¼šè¿›è¡Œå®Œæ•´å®‰å…¨å®¡è®¡
- æ¯å­£åº¦ï¼šæ›´æ–°å®‰å…¨ç­–ç•¥å’Œé…ç½®

**æ ¸å¿ƒè®°å¿†**ï¼š
- ä¼šè¯å®‰å…¨æ˜¯Webåº”ç”¨çš„ç”Ÿå‘½çº¿ï¼Œéœ€è¦å¤šå±‚é˜²æŠ¤
- å®‰å…¨é…ç½®è¦å…¨é¢ï¼Œä½†ä¸èƒ½å½±å“æ­£å¸¸ç”¨æˆ·ä½“éªŒ
- æŒç»­ç›‘æ§å’ŒåŠæ—¶å“åº”æ˜¯å®‰å…¨é˜²æŠ¤çš„å…³é”®
- å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­æ”¹è¿›çš„è¿‡ç¨‹ï¼Œä¸èƒ½ä¸€åŠ³æ°¸é€¸