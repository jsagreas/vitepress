---
title: 4ã€Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Sessionç”Ÿå‘½å‘¨æœŸ](#1-ä»€ä¹ˆæ˜¯Sessionç”Ÿå‘½å‘¨æœŸ)
2. [Sessionçš„åˆ›å»ºæ—¶æœº](#2-Sessionçš„åˆ›å»ºæ—¶æœº)
3. [Sessionçš„é»˜è®¤è¶…æ—¶æœºåˆ¶](#3-Sessionçš„é»˜è®¤è¶…æ—¶æœºåˆ¶)
4. [æ‰‹åŠ¨ç®¡ç†Sessionæ—¶é—´](#4-æ‰‹åŠ¨ç®¡ç†Sessionæ—¶é—´)
5. [Sessionçš„é”€æ¯æ–¹å¼](#5-Sessionçš„é”€æ¯æ–¹å¼)
6. [æµè§ˆå™¨å…³é—­å¯¹Sessionçš„å½±å“](#6-æµè§ˆå™¨å…³é—­å¯¹Sessionçš„å½±å“)
7. [Sessionç”Ÿå‘½å‘¨æœŸæœ€ä½³å®è·µ](#7-Sessionç”Ÿå‘½å‘¨æœŸæœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ ä»€ä¹ˆæ˜¯Sessionç”Ÿå‘½å‘¨æœŸ


### 1.1 ç”Ÿå‘½å‘¨æœŸçš„åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆå«ç”Ÿå‘½å‘¨æœŸ**
```
å°±åƒäººæœ‰å‡ºç”Ÿã€æˆé•¿ã€æ­»äº¡ä¸€æ ·ï¼ŒSessionä¹Ÿæœ‰è‡ªå·±çš„"ä¸€ç”Ÿ"ï¼š
âœ… åˆ›å»ºï¼šç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ—¶è¯ç”Ÿ
âœ… æ´»è·ƒï¼šç”¨æˆ·æŒç»­è®¿é—®æ—¶ä¿æŒæ´»è·ƒ
âœ… è¶…æ—¶ï¼šç”¨æˆ·é•¿æ—¶é—´ä¸è®¿é—®ä¼š"ä¼‘çœ "
âœ… é”€æ¯ï¼šè¾¾åˆ°æ¡ä»¶æ—¶å½»åº•æ¶ˆå¤±
```

### 1.2 ç”Ÿå‘½å‘¨æœŸçš„é‡è¦æ€§


**ğŸ’¡ ä¸ºä»€ä¹ˆè¦ç®¡ç†Sessionç”Ÿå‘½å‘¨æœŸ**
- **å†…å­˜ç®¡ç†**ï¼šé¿å…æœåŠ¡å™¨å†…å­˜è¢«æ— ç”¨Sessionå æ»¡
- **å®‰å…¨è€ƒè™‘**ï¼šåŠæ—¶æ¸…ç†è¿‡æœŸçš„ç”¨æˆ·ä¼šè¯ä¿¡æ¯
- **ç”¨æˆ·ä½“éªŒ**ï¼šåˆç†çš„è¶…æ—¶æ—¶é—´å¹³è¡¡å®‰å…¨æ€§å’Œä¾¿åˆ©æ€§
- **ç³»ç»Ÿæ€§èƒ½**ï¼šæ§åˆ¶åŒæ—¶å­˜åœ¨çš„Sessionæ•°é‡

### 1.3 ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å›¾


```
Sessionç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼š

[ç”¨æˆ·è®¿é—®] â†’ [Sessionåˆ›å»º] â†’ [ç”¨æˆ·æ´»è·ƒ] â†’ [æ›´æ–°æœ€åè®¿é—®æ—¶é—´]
                    â†“              â†‘              â†“
               [åˆ†é…SessionID]     â†“         [æ£€æŸ¥è¶…æ—¶]
                    â†“              â†“              â†“
               [å­˜å‚¨åˆ°å†…å­˜]  â† [æŒç»­è®¿é—®] â† [æœªè¶…æ—¶ç»§ç»­]
                    â†“                             â†“
               [è®¾ç½®Cookie] â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ [è¶…æ—¶æˆ–ä¸»åŠ¨é”€æ¯]
                                              â†“
                                         [Sessioné”€æ¯]
```

---

## 2. ğŸš€ Sessionçš„åˆ›å»ºæ—¶æœº


### 2.1 ä½•æ—¶åˆ›å»ºSession


**ğŸ”¸ Sessionåˆ›å»ºçš„è§¦å‘æ¡ä»¶**

| è§¦å‘æ–¹å¼ | è¯´æ˜ | å¸¸è§åœºæ™¯ |
|---------|------|----------|
| **`request.getSession()`** | `ä¸»åŠ¨è·å–Sessionï¼Œæ²¡æœ‰åˆ™åˆ›å»º` | `ç”¨æˆ·ç™»å½•æ—¶` |
| **`request.getSession(true)`** | `å¼ºåˆ¶åˆ›å»ºSession` | `éœ€è¦ç¡®ä¿æœ‰Session` |
| **JSPé¡µé¢é»˜è®¤** | `JSPé»˜è®¤åˆ›å»ºSession` | `è®¿é—®JSPé¡µé¢` |

### 2.2 åˆ›å»ºæ—¶æœºè¯¦è§£


**ğŸ’» ä»£ç æ¼”ç¤ºï¼šè§‚å¯ŸSessionåˆ›å»º**
```java
@WebServlet("/sessionDemo")
public class SessionDemoServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) {
        
        // æ£€æŸ¥æ˜¯å¦å·²æœ‰Sessionï¼ˆä¸åˆ›å»ºæ–°çš„ï¼‰
        HttpSession existingSession = request.getSession(false);
        
        if (existingSession == null) {
            System.out.println("å½“å‰æ²¡æœ‰Sessionï¼Œå³å°†åˆ›å»ºæ–°çš„");
            
            // åˆ›å»ºæ–°Session
            HttpSession newSession = request.getSession(true);
            System.out.println("æ–°Sessionåˆ›å»ºæˆåŠŸï¼ŒIDï¼š" + newSession.getId());
            System.out.println("åˆ›å»ºæ—¶é—´ï¼š" + new Date(newSession.getCreationTime()));
            
        } else {
            System.out.println("ä½¿ç”¨ç°æœ‰Sessionï¼ŒIDï¼š" + existingSession.getId());
        }
    }
}
```

### 2.3 åˆ›å»ºæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ


**ğŸ” Sessionåˆ›å»ºçš„å†…éƒ¨è¿‡ç¨‹**
```
1. æœåŠ¡å™¨ç”Ÿæˆå”¯ä¸€SessionIDï¼ˆ32ä½éšæœºå­—ç¬¦ä¸²ï¼‰
2. åœ¨æœåŠ¡å™¨å†…å­˜ä¸­åˆ›å»ºHttpSessionå¯¹è±¡
3. å°†SessionIDä»¥Cookieå½¢å¼å‘é€ç»™æµè§ˆå™¨
4. æµè§ˆå™¨ä¿å­˜è¿™ä¸ªSessionID Cookie
5. åç»­è¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦è¿™ä¸ªSessionID
```

**ğŸ“‹ åˆ›å»ºæ—¶çš„å…³é”®å±æ€§**
- **SessionID**ï¼šå…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦
- **åˆ›å»ºæ—¶é—´**ï¼š`getCreationTime()`è·å–
- **æœ€åè®¿é—®æ—¶é—´**ï¼š`getLastAccessedTime()`è·å–
- **æœ€å¤§éæ´»è·ƒé—´éš”**ï¼šé»˜è®¤30åˆ†é’Ÿ

---

## 3. â° Sessionçš„é»˜è®¤è¶…æ—¶æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯Sessionè¶…æ—¶


**ğŸ”¸ è¶…æ—¶æœºåˆ¶ç®€å•ç†è§£**
```
æƒ³è±¡ä½ åœ¨å›¾ä¹¦é¦†å åº§ï¼š
âŒ å¦‚æœä½ 30åˆ†é’Ÿä¸å›æ¥ï¼Œåº§ä½å°±è¢«æ”¶å›
âœ… æ¯æ¬¡ä½ å›æ¥åä¸€ä¸‹ï¼Œ30åˆ†é’Ÿé‡æ–°è®¡æ—¶

Sessionè¶…æ—¶å°±æ˜¯è¿™ä¸ªé“ç†ï¼š
- ç”¨æˆ·30åˆ†é’Ÿä¸è®¿é—®ï¼ŒSessionè¢«æ¸…ç†
- æ¯æ¬¡è®¿é—®éƒ½ä¼šé‡ç½®è®¡æ—¶å™¨
- è¿™æ ·é¿å…æœåŠ¡å™¨å†…å­˜è¢«å æ»¡
```

### 3.2 é»˜è®¤è¶…æ—¶æ—¶é—´


**ğŸ“Š å„ç§ç¯å¢ƒçš„é»˜è®¤è¶…æ—¶æ—¶é—´**

| ç¯å¢ƒ | é»˜è®¤è¶…æ—¶æ—¶é—´ | é…ç½®æ–¹å¼ |
|------|-------------|----------|
| **Tomcat** | `30åˆ†é’Ÿ` | `web.xmlé…ç½®` |
| **Jetty** | `30åˆ†é’Ÿ` | `é…ç½®æ–‡ä»¶` |
| **Spring Boot** | `30åˆ†é’Ÿ` | `application.properties` |

### 3.3 web.xmlä¸­é…ç½®è¶…æ—¶


```xml
<!-- web.xmlé…ç½®Sessionè¶…æ—¶æ—¶é—´ -->
<web-app>
    <session-config>
        <!-- å•ä½ï¼šåˆ†é’Ÿ -->
        <session-timeout>20</session-timeout>
    </session-config>
</web-app>
```

### 3.4 è¶…æ—¶æ£€æŸ¥æœºåˆ¶


**âš¡ æœåŠ¡å™¨å¦‚ä½•æ£€æŸ¥è¶…æ—¶**
```
æœåŠ¡å™¨å®šæœŸæ£€æŸ¥ï¼ˆé€šå¸¸æ¯åˆ†é’Ÿä¸€æ¬¡ï¼‰ï¼š
1. è·å–Sessionçš„æœ€åè®¿é—®æ—¶é—´
2. è®¡ç®—è·ç¦»ç°åœ¨çš„æ—¶é—´å·®
3. å¦‚æœè¶…è¿‡è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼Œæ ‡è®°ä¸ºè¿‡æœŸ
4. åœ¨ä¸‹æ¬¡æ¸…ç†æ—¶åˆ é™¤è¿‡æœŸSession

æ³¨æ„ï¼šä¸æ˜¯åˆ°æ—¶é—´ç«‹å³åˆ é™¤ï¼Œè€Œæ˜¯å®šæœŸæ‰¹é‡æ¸…ç†
```

---

## 4. ğŸ› ï¸ æ‰‹åŠ¨ç®¡ç†Sessionæ—¶é—´


### 4.1 setMaxInactiveInterval()æ–¹æ³•


**ğŸ”¸ åŠ¨æ€è®¾ç½®è¶…æ—¶æ—¶é—´**

è¿™ä¸ªæ–¹æ³•å¯ä»¥ä¸ºç‰¹å®šSessionè®¾ç½®ä¸“é—¨çš„è¶…æ—¶æ—¶é—´ï¼Œæ¯”web.xmlçš„å…¨å±€è®¾ç½®ä¼˜å…ˆçº§æ›´é«˜ã€‚

```java
@WebServlet("/timeoutDemo")
public class TimeoutDemoServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) {
        HttpSession session = request.getSession();
        
        // è·å–å½“å‰è¶…æ—¶è®¾ç½®ï¼ˆç§’ï¼‰
        int currentTimeout = session.getMaxInactiveInterval();
        System.out.println("å½“å‰è¶…æ—¶æ—¶é—´ï¼š" + currentTimeout + " ç§’");
        
        // è®¾ç½®ä¸º10åˆ†é’Ÿï¼ˆ600ç§’ï¼‰
        session.setMaxInactiveInterval(600);
        
        // VIPç”¨æˆ·è®¾ç½®æ›´é•¿æ—¶é—´ï¼ˆ2å°æ—¶ï¼‰
        String userType = (String) session.getAttribute("userType");
        if ("VIP".equals(userType)) {
            session.setMaxInactiveInterval(7200); // 2å°æ—¶
        }
    }
}
```

### 4.2 ä¸åŒåœºæ™¯çš„è¶…æ—¶è®¾ç½®


**ğŸ¯ æ ¹æ®ä¸šåŠ¡åœºæ™¯è®¾ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´**

| åº”ç”¨åœºæ™¯ | å»ºè®®è¶…æ—¶æ—¶é—´ | åŸå›  |
|---------|-------------|------|
| **é“¶è¡Œç³»ç»Ÿ** | `5-10åˆ†é’Ÿ` | `å®‰å…¨æ€§è¦æ±‚æé«˜` |
| **ç”µå•†ç½‘ç«™** | `30åˆ†é’Ÿ` | `å¹³è¡¡è´­ç‰©ä½“éªŒå’Œå®‰å…¨` |
| **ç¤¾äº¤å¹³å°** | `1-2å°æ—¶` | `ç”¨æˆ·åœç•™æ—¶é—´è¾ƒé•¿` |
| **å†…éƒ¨ç³»ç»Ÿ** | `4-8å°æ—¶` | `å·¥ä½œæœŸé—´æŒç»­ä½¿ç”¨` |

### 4.3 åŠ¨æ€è¶…æ—¶ç®¡ç†ç¤ºä¾‹


```java
// æ ¹æ®ç”¨æˆ·è¡Œä¸ºåŠ¨æ€è°ƒæ•´è¶…æ—¶æ—¶é—´
public void adjustSessionTimeout(HttpSession session, String action) {
    
    switch (action) {
        case "login":
            // åˆšç™»å½•ï¼Œç»™äºˆæ ‡å‡†æ—¶é—´
            session.setMaxInactiveInterval(1800); // 30åˆ†é’Ÿ
            break;
            
        case "sensitive_operation":
            // æ•æ„Ÿæ“ä½œåï¼Œç¼©çŸ­è¶…æ—¶æ—¶é—´
            session.setMaxInactiveInterval(300); // 5åˆ†é’Ÿ
            break;
            
        case "normal_browsing":
            // æ™®é€šæµè§ˆï¼Œæ¢å¤æ ‡å‡†æ—¶é—´
            session.setMaxInactiveInterval(1800); // 30åˆ†é’Ÿ
            break;
    }
}
```

---

## 5. ğŸ’¥ Sessionçš„é”€æ¯æ–¹å¼


### 5.1 è‡ªåŠ¨é”€æ¯ï¼ˆè¶…æ—¶ï¼‰


**ğŸ”¸ è¶…æ—¶é”€æ¯æ˜¯æœ€å¸¸è§çš„æ–¹å¼**

```java
// æ£€æŸ¥Sessionæ˜¯å¦è¿˜æœ‰æ•ˆ
@WebServlet("/checkSession")
public class CheckSessionServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        HttpSession session = request.getSession(false); // ä¸åˆ›å»ºæ–°Session
        
        if (session == null) {
            response.getWriter().println("Sessionå·²è¶…æ—¶æˆ–ä¸å­˜åœ¨");
            return;
        }
        
        // è®¡ç®—Sessionå‰©ä½™æ—¶é—´
        int maxInactive = session.getMaxInactiveInterval();
        long lastAccess = session.getLastAccessedTime();
        long now = System.currentTimeMillis();
        long inactive = (now - lastAccess) / 1000; // è½¬æ¢ä¸ºç§’
        long remaining = maxInactive - inactive;
        
        if (remaining > 0) {
            response.getWriter().println("Sessionè¿˜æœ‰ " + remaining + " ç§’è¿‡æœŸ");
        } else {
            response.getWriter().println("Sessionå³å°†è¿‡æœŸ");
        }
    }
}
```

### 5.2 ä¸»åŠ¨é”€æ¯ï¼ˆinvalidate()ï¼‰


**ğŸ”¸ æ‰‹åŠ¨é”€æ¯Session**

æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯ç”¨æˆ·é€€å‡ºç™»å½•æ—¶ï¼Œåº”è¯¥ç«‹å³é”€æ¯Sessionä¿è¯å®‰å…¨ã€‚

```java
@WebServlet("/logout")
public class LogoutServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        HttpSession session = request.getSession(false);
        
        if (session != null) {
            // è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆé”€æ¯å‰ï¼‰
            String username = (String) session.getAttribute("username");
            System.out.println("ç”¨æˆ· " + username + " é€€å‡ºç™»å½•");
            
            // ä¸»åŠ¨é”€æ¯Session
            session.invalidate();
            
            response.getWriter().println("é€€å‡ºæˆåŠŸï¼ŒSessionå·²æ¸…ç†");
        } else {
            response.getWriter().println("å½“å‰æ²¡æœ‰æœ‰æ•ˆçš„Session");
        }
    }
}
```

### 5.3 æœåŠ¡å™¨å…³é—­


**ğŸ”¸ æœåŠ¡å™¨åœæœºæ—¶çš„Sessionå¤„ç†**
```
æœåŠ¡å™¨å…³é—­æ—¶ï¼š
1. æ‰€æœ‰å†…å­˜ä¸­çš„Sessionéƒ½ä¼šä¸¢å¤±
2. ç”¨æˆ·ä¸‹æ¬¡è®¿é—®éœ€è¦é‡æ–°ç™»å½•
3. å¯ä»¥é€šè¿‡SessionæŒä¹…åŒ–æ¥è§£å†³è¿™ä¸ªé—®é¢˜

æ³¨æ„ï¼š
- æ­£å¸¸å…³é—­ï¼šTomcatä¼šå°è¯•ä¿å­˜Sessionåˆ°ç£ç›˜
- å¼‚å¸¸å…³é—­ï¼šSessionç›´æ¥ä¸¢å¤±
- é›†ç¾¤ç¯å¢ƒï¼šå¯ä»¥å°†Sessionå­˜å‚¨åˆ°Redisç­‰å¤–éƒ¨å­˜å‚¨
```

### 5.4 é”€æ¯åçš„çŠ¶æ€


```java
// æ¼”ç¤ºSessioné”€æ¯åçš„çŠ¶æ€
HttpSession session = request.getSession();
session.setAttribute("test", "value");

session.invalidate(); // é”€æ¯Session

try {
    session.getAttribute("test"); // è¿™é‡Œä¼šæŠ›å¼‚å¸¸
} catch (IllegalStateException e) {
    System.out.println("Sessionå·²è¢«é”€æ¯ï¼Œæ— æ³•è®¿é—®ï¼š" + e.getMessage());
}
```

---

## 6. ğŸŒ æµè§ˆå™¨å…³é—­å¯¹Sessionçš„å½±å“


### 6.1 å¸¸è§è¯¯è§£æ¾„æ¸…


**âŒ é”™è¯¯ç†è§£ï¼šæµè§ˆå™¨å…³é—­Sessionå°±é”€æ¯äº†**
**âœ… æ­£ç¡®ç†è§£ï¼šæµè§ˆå™¨å…³é—­åªæ˜¯ä¸¢å¤±äº†SessionIDï¼ŒSessionæœ¬èº«è¿˜åœ¨æœåŠ¡å™¨ä¸Š**

```
æµè§ˆå™¨å…³é—­æ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼š

æµè§ˆå™¨ç«¯ï¼š
- SessionID Cookieè¢«æ¸…é™¤ï¼ˆå› ä¸ºæ˜¯ä¼šè¯çº§Cookieï¼‰
- æ— æ³•å†è®¿é—®ä¹‹å‰çš„Session

æœåŠ¡å™¨ç«¯ï¼š
- Sessionå¯¹è±¡ä¾ç„¶å­˜åœ¨äºå†…å­˜ä¸­
- ç»§ç»­å€’è®¡æ—¶ï¼Œç›´åˆ°è¶…æ—¶æ‰é”€æ¯
- å¦‚æœåœ¨è¶…æ—¶å‰ç”¨æˆ·é‡æ–°è®¿é—®ï¼Œä¼šåˆ›å»ºæ–°Session
```

### 6.2 å®éªŒéªŒè¯


**ğŸ”¬ éªŒè¯æµè§ˆå™¨å…³é—­çš„å½±å“**

```java
@WebServlet("/browserTest")
public class BrowserTestServlet extends HttpServlet {
    
    // ç”¨äºå­˜å‚¨æ‰€æœ‰Sessionä¿¡æ¯
    private static Map<String, String> allSessions = new ConcurrentHashMap<>();
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        HttpSession session = request.getSession();
        String sessionId = session.getId();
        
        // è®°å½•Sessionåˆ›å»ºæ—¶é—´
        if (session.isNew()) {
            String createTime = new Date().toString();
            allSessions.put(sessionId, createTime);
            response.getWriter().println("æ–°Sessionåˆ›å»ºï¼š" + sessionId);
            response.getWriter().println("åˆ›å»ºæ—¶é—´ï¼š" + createTime);
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰å­˜æ´»çš„Session
        response.getWriter().println("\nå½“å‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰Sessionï¼š");
        for (Map.Entry<String, String> entry : allSessions.entrySet()) {
            response.getWriter().println("ID: " + entry.getKey() + 
                                       " åˆ›å»ºæ—¶é—´: " + entry.getValue());
        }
        
        // æ¸…ç†è¯´æ˜
        response.getWriter().println("\nè¯´æ˜ï¼šå…³é—­æµè§ˆå™¨åé‡æ–°è®¿é—®ï¼Œä¼šçœ‹åˆ°æ—§Sessionä»ç„¶å­˜åœ¨");
    }
}
```

### 6.3 ä¸åŒæµè§ˆå™¨è¡Œä¸º


**ğŸ“Š å„æµè§ˆå™¨å¯¹Session Cookieçš„å¤„ç†**

| æµè§ˆå™¨ | Cookieå¤„ç† | ç‰¹æ®Šæƒ…å†µ |
|--------|------------|----------|
| **Chrome** | `å…³é—­çª—å£æ¸…é™¤ä¼šè¯Cookie` | `æ¢å¤æ ‡ç­¾é¡µåŠŸèƒ½å¯èƒ½ä¿ç•™` |
| **Firefox** | `å…³é—­çª—å£æ¸…é™¤ä¼šè¯Cookie` | `ä¼šè¯æ¢å¤ä¸åŒ…å«Cookie` |
| **Edge** | `å…³é—­çª—å£æ¸…é™¤ä¼šè¯Cookie` | `InPrivateæ¨¡å¼ç«‹å³æ¸…é™¤` |
| **Safari** | `å…³é—­çª—å£æ¸…é™¤ä¼šè¯Cookie` | `è·¨è®¾å¤‡åŒæ­¥ä¸åŒ…å«ä¼šè¯Cookie` |

### 6.4 å¦‚ä½•å¤„ç†æµè§ˆå™¨å…³é—­


```java
// æ£€æµ‹å¯èƒ½çš„æµè§ˆå™¨å…³é—­ï¼ˆé€šè¿‡æ–°Sessionåˆ¤æ–­ï¼‰
@WebServlet("/sessionCheck")
public class SessionCheckServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        HttpSession session = request.getSession();
        
        if (session.isNew()) {
            // å¯èƒ½æ˜¯æµè§ˆå™¨å…³é—­åé‡æ–°è®¿é—®
            response.getWriter().println("æ£€æµ‹åˆ°æ–°Sessionï¼Œå¯èƒ½éœ€è¦é‡æ–°ç™»å½•");
            
            // é‡å®šå‘åˆ°ç™»å½•é¡µé¢
            response.sendRedirect("login.html");
        } else {
            // æ­£å¸¸è®¿é—®
            String username = (String) session.getAttribute("username");
            response.getWriter().println("æ¬¢è¿å›æ¥ï¼Œ" + username);
        }
    }
}
```

---

## 7. ğŸ¯ Sessionç”Ÿå‘½å‘¨æœŸæœ€ä½³å®è·µ


### 7.1 å®‰å…¨æ€§æœ€ä½³å®è·µ


**ğŸ”’ ä¿éšœSessionå®‰å…¨çš„å…³é”®ç‚¹**

```java
@WebServlet("/secureSession")
public class SecureSessionServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) {
        HttpSession session = request.getSession();
        
        // 1. ç™»å½•æˆåŠŸåé‡æ–°ç”ŸæˆSessionIDï¼ˆé˜²æ­¢Sessionå›ºå®šæ”»å‡»ï¼‰
        request.changeSessionId();
        
        // 2. æ ¹æ®ç”¨æˆ·è§’è‰²è®¾ç½®ä¸åŒçš„è¶…æ—¶æ—¶é—´
        String userRole = getUserRole(request);
        if ("admin".equals(userRole)) {
            session.setMaxInactiveInterval(600); // ç®¡ç†å‘˜10åˆ†é’Ÿ
        } else {
            session.setMaxInactiveInterval(1800); // æ™®é€šç”¨æˆ·30åˆ†é’Ÿ
        }
        
        // 3. è®°å½•å…³é”®ä¿¡æ¯ç”¨äºå®¡è®¡
        session.setAttribute("loginTime", System.currentTimeMillis());
        session.setAttribute("clientIP", request.getRemoteAddr());
        
        // 4. æ•æ„Ÿæ“ä½œåç¼©çŸ­è¶…æ—¶æ—¶é—´
        session.setAttribute("lastSensitiveOp", System.currentTimeMillis());
    }
    
    private String getUserRole(HttpServletRequest request) {
        // ä»æ•°æ®åº“æˆ–è®¤è¯ç³»ç»Ÿè·å–ç”¨æˆ·è§’è‰²
        return "user";
    }
}
```

### 7.2 æ€§èƒ½ä¼˜åŒ–å®è·µ


**âš¡ Sessionæ€§èƒ½ä¼˜åŒ–è¦ç‚¹**

| ä¼˜åŒ–ç­–ç•¥ | å…·ä½“åšæ³• | æ•ˆæœ |
|---------|----------|------|
| **åŠæ—¶æ¸…ç†** | `ç”¨æˆ·é€€å‡ºä¸»åŠ¨è°ƒç”¨invalidate()` | `é‡Šæ”¾å†…å­˜èµ„æº` |
| **åˆç†è¶…æ—¶** | `æ ¹æ®ä¸šåŠ¡è®¾ç½®è¶…æ—¶æ—¶é—´` | `å¹³è¡¡æ€§èƒ½ä¸ä½“éªŒ` |
| **ç²¾ç®€æ•°æ®** | `åªå­˜å‚¨å¿…è¦ä¿¡æ¯` | `å‡å°‘å†…å­˜å ç”¨` |
| **é›†ç¾¤æ–¹æ¡ˆ** | `Redisç­‰å¤–éƒ¨å­˜å‚¨` | `æ”¯æŒæ°´å¹³æ‰©å±•` |

### 7.3 ç”¨æˆ·ä½“éªŒä¼˜åŒ–


```java
// Sessionå³å°†è¿‡æœŸçš„æé†’æœºåˆ¶
@WebServlet("/sessionStatus")
public class SessionStatusServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        HttpSession session = request.getSession(false);
        
        if (session == null) {
            response.getWriter().write("{\"status\":\"expired\"}");
            return;
        }
        
        // è®¡ç®—å‰©ä½™æ—¶é—´
        int maxInactive = session.getMaxInactiveInterval();
        long lastAccess = session.getLastAccessedTime();
        long now = System.currentTimeMillis();
        long remainingSeconds = maxInactive - (now - lastAccess) / 1000;
        
        // æ„é€ å“åº”JSON
        String json = String.format(
            "{\"status\":\"active\", \"remainingMinutes\":%d, \"warning\":%b}",
            remainingSeconds / 60,
            remainingSeconds < 300 // 5åˆ†é’Ÿå†…æ˜¾ç¤ºè­¦å‘Š
        );
        
        response.setContentType("application/json");
        response.getWriter().write(json);
    }
}
```

### 7.4 ç›‘æ§å’Œè°ƒè¯•


**ğŸ“Š SessionçŠ¶æ€ç›‘æ§**

```java
// Sessionç»Ÿè®¡å’Œç›‘æ§
@WebServlet("/sessionStats")
public class SessionStatsServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        // è·å–Sessionç»Ÿè®¡ä¿¡æ¯ï¼ˆéœ€è¦é…ç½®ç®¡ç†å™¨ï¼‰
        response.setContentType("text/html");
        PrintWriter out = response.getWriter();
        
        out.println("<h2>Sessionç»Ÿè®¡ä¿¡æ¯</h2>");
        out.println("<p>å½“å‰æ´»è·ƒSessionæ•°é‡ï¼š" + getActiveSessionCount() + "</p>");
        out.println("<p>Sessionåˆ›å»ºæ€»æ•°ï¼š" + getSessionCreateCount() + "</p>");
        out.println("<p>Sessionè¿‡æœŸæ€»æ•°ï¼š" + getSessionExpiredCount() + "</p>");
        out.println("<p>å¹³å‡Sessionå­˜æ´»æ—¶é—´ï¼š" + getAverageSessionLifetime() + " åˆ†é’Ÿ</p>");
    }
    
    // è¿™äº›æ–¹æ³•éœ€è¦é€šè¿‡JMXæˆ–è‡ªå®šä¹‰ç»Ÿè®¡å®ç°
    private int getActiveSessionCount() { return 0; }
    private long getSessionCreateCount() { return 0L; }
    private long getSessionExpiredCount() { return 0L; }
    private double getAverageSessionLifetime() { return 0.0; }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å…³é”®æ¦‚å¿µå›é¡¾


```
ğŸ”¸ Sessionç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»º â†’ æ´»è·ƒ â†’ è¶…æ—¶/é”€æ¯
ğŸ”¸ åˆ›å»ºæ—¶æœºï¼šé¦–æ¬¡è°ƒç”¨getSession()æˆ–è®¿é—®JSP
ğŸ”¸ é»˜è®¤è¶…æ—¶ï¼š30åˆ†é’Ÿï¼ˆå¯é€šè¿‡web.xmlæˆ–ä»£ç ä¿®æ”¹ï¼‰
ğŸ”¸ é”€æ¯æ–¹å¼ï¼šè¶…æ—¶è‡ªåŠ¨é”€æ¯ã€ä¸»åŠ¨invalidate()ã€æœåŠ¡å™¨å…³é—­
ğŸ”¸ æµè§ˆå™¨å…³é—­ï¼šåªæ¸…é™¤SessionID Cookieï¼ŒSessionæœ¬èº«ä»åœ¨æœåŠ¡å™¨
```

### 8.2 é‡è¦APIæ€»ç»“


| æ–¹æ³• | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| **`getSession()`** | `è·å–æˆ–åˆ›å»ºSession` | `å¤§å¤šæ•°æƒ…å†µ` |
| **`getSession(false)`** | `è·å–Sessionï¼Œä¸å­˜åœ¨è¿”å›null` | `æ£€æŸ¥Sessionæ˜¯å¦å­˜åœ¨` |
| **`setMaxInactiveInterval(int)`** | `è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰` | `åŠ¨æ€è°ƒæ•´è¶…æ—¶` |
| **`invalidate()`** | `ç«‹å³é”€æ¯Session` | `ç”¨æˆ·é€€å‡ºç™»å½•` |
| **`isNew()`** | `åˆ¤æ–­æ˜¯å¦æ–°åˆ›å»º` | `æ£€æµ‹æµè§ˆå™¨å…³é—­` |

### 8.3 å®è·µè¦ç‚¹


**ğŸ¯ å¼€å‘ä¸­çš„æ³¨æ„äº‹é¡¹**
- âœ… **åŠæ—¶é”€æ¯**ï¼šç”¨æˆ·é€€å‡ºæ—¶è°ƒç”¨`invalidate()`
- âœ… **åˆç†è¶…æ—¶**ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯è®¾ç½®è¶…æ—¶æ—¶é—´
- âœ… **å®‰å…¨è€ƒè™‘**ï¼šæ•æ„Ÿæ“ä½œåé‡æ–°ç”ŸæˆSessionID
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…åœ¨Sessionä¸­å­˜å‚¨å¤§å¯¹è±¡
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šè¶…æ—¶å‰ç»™ç”¨æˆ·è­¦å‘Šæç¤º

**ğŸ” å¸¸è§é—®é¢˜è§£ç­”**
```
Q: Sessionä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ›å»ºï¼Ÿ
A: è°ƒç”¨request.getSession()æˆ–è®¿é—®JSPé¡µé¢æ—¶

Q: æµè§ˆå™¨å…³é—­Sessionä¼šç«‹å³é”€æ¯å—ï¼Ÿ
A: ä¸ä¼šï¼ŒSessionç»§ç»­åœ¨æœåŠ¡å™¨å­˜æ´»ç›´åˆ°è¶…æ—¶

Q: å¦‚ä½•å»¶é•¿Sessionæœ‰æ•ˆæœŸï¼Ÿ
A: è°ƒç”¨session.setMaxInactiveInterval()è®¾ç½®æ›´é•¿æ—¶é—´

Q: Sessionå ç”¨å¤šå°‘å†…å­˜ï¼Ÿ
A: å–å†³äºå­˜å‚¨çš„æ•°æ®é‡ï¼Œå»ºè®®åªå­˜å‚¨å¿…è¦ä¿¡æ¯

Q: é›†ç¾¤ç¯å¢ƒå¦‚ä½•å¤„ç†Sessionï¼Ÿ
A: å¯ä»¥ä½¿ç”¨Sessionå¤åˆ¶ã€ç²˜æ€§ä¼šè¯æˆ–å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚Redisï¼‰
```

**ğŸ’¡ è®°å¿†è¦ç‚¹**
- Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†æ˜¯Webå¼€å‘çš„åŸºç¡€
- ç†è§£è¶…æ—¶æœºåˆ¶æœ‰åŠ©äºä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- ä¸»åŠ¨é”€æ¯Sessionæ˜¯è‰¯å¥½çš„å®‰å…¨å®è·µ
- æµè§ˆå™¨å…³é—­ä¸ç­‰äºSessioné”€æ¯
- åˆç†é…ç½®è¶…æ—¶æ—¶é—´å¹³è¡¡å®‰å…¨å’Œä¾¿åˆ©æ€§