---
title: 5ã€Sessioné…ç½®ä¸ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [Sessionè¶…æ—¶é…ç½®è¯¦è§£](#1-Sessionè¶…æ—¶é…ç½®è¯¦è§£)
2. [ç¨‹åºåŠ¨æ€è®¾ç½®Session](#2-ç¨‹åºåŠ¨æ€è®¾ç½®Session)
3. [Sessionæ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#3-Sessionæ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
4. [å†…å­˜ä½¿ç”¨æ§åˆ¶ä¸ç›‘æ§](#4-å†…å­˜ä½¿ç”¨æ§åˆ¶ä¸ç›‘æ§)
5. [Sessioné…ç½®æœ€ä½³å®è·µ](#5-Sessioné…ç½®æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ•’ Sessionè¶…æ—¶é…ç½®è¯¦è§£


### 1.1 ä»€ä¹ˆæ˜¯Sessionè¶…æ—¶


**é€šä¿—ç†è§£**ï¼š
æƒ³è±¡ä½ å»é“¶è¡ŒåŠä¸šåŠ¡ï¼Œå–äº†å·ç åœ¨ç­‰å¾…ã€‚å¦‚æœä½ é•¿æ—¶é—´æ²¡æœ‰å“åº”å«å·ï¼Œé“¶è¡Œä¼šè®¤ä¸ºä½ å·²ç»ç¦»å¼€ï¼Œä¼šæŠŠä½ çš„å·ç ä½œåºŸã€‚Sessionè¶…æ—¶å°±æ˜¯è¿™ä¸ªé“ç† - å½“ç”¨æˆ·é•¿æ—¶é—´ä¸æ“ä½œç½‘ç«™æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨æ¸…ç†è¿™ä¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚

**æŠ€æœ¯å«ä¹‰**ï¼š
- **Sessionè¶…æ—¶ï¼ˆSession Timeoutï¼‰**ï¼šæŒ‡Sessionå¯¹è±¡åœ¨å¤šé•¿æ—¶é—´å†…æ²¡æœ‰è¢«è®¿é—®å°±ä¼šè¢«æœåŠ¡å™¨è‡ªåŠ¨é”€æ¯
- **é»˜è®¤æ—¶é—´**ï¼šå¤§å¤šæ•°æœåŠ¡å™¨é»˜è®¤æ˜¯30åˆ†é’Ÿ
- **ä½œç”¨**ï¼šé‡Šæ”¾æœåŠ¡å™¨å†…å­˜ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œå¢å¼ºå®‰å…¨æ€§

### 1.2 web.xmlä¸­çš„è¶…æ—¶é…ç½®


**åŸºæœ¬é…ç½®è¯­æ³•**ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://java.sun.com/xml/ns/javaee"
         version="3.0">
    
    <!-- Sessionè¶…æ—¶é…ç½® -->
    <session-config>
        <session-timeout>30</session-timeout>
    </session-config>
    
</web-app>
```

**é…ç½®è¯´æ˜**ï¼š
```
ğŸ”¸ session-timeoutæ ‡ç­¾ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´
ğŸ”¸ æ—¶é—´å•ä½ï¼šåˆ†é’Ÿï¼ˆminutesï¼‰
ğŸ”¸ æ•°å€¼å«ä¹‰ï¼š30è¡¨ç¤º30åˆ†é’Ÿæ— æ“ä½œåSessionå¤±æ•ˆ
ğŸ”¸ ç”Ÿæ•ˆèŒƒå›´ï¼šæ•´ä¸ªWebåº”ç”¨çš„æ‰€æœ‰Session
```

### 1.3 session-timeoutæ ‡ç­¾æ·±åº¦è§£æ


**æ ‡ç­¾ä½ç½®å…³ç³»**ï¼š
```
web.xmlæ–‡ä»¶ç»“æ„ï¼š
web-app (æ ¹å…ƒç´ )
â”œâ”€â”€ display-name
â”œâ”€â”€ servleté…ç½®
â”œâ”€â”€ filteré…ç½®  
â”œâ”€â”€ session-config â† Sessioné…ç½®åœ¨è¿™é‡Œ
â”‚   â”œâ”€â”€ session-timeout â† è¶…æ—¶æ—¶é—´é…ç½®
â”‚   â”œâ”€â”€ cookie-config â† Cookieç›¸å…³é…ç½®
â”‚   â””â”€â”€ tracking-mode â† è·Ÿè¸ªæ¨¡å¼é…ç½®
â””â”€â”€ welcome-file-list
```

**ä¸åŒè¶…æ—¶å€¼çš„å®é™…æ„ä¹‰**ï¼š

| è¶…æ—¶æ—¶é—´ | **é€‚ç”¨åœºæ™¯** | **ç”¨æˆ·ä½“éªŒ** | **æœåŠ¡å™¨å‹åŠ›** |
|---------|------------|-------------|---------------|
| `5åˆ†é’Ÿ` | `é«˜å®‰å…¨æ€§åº”ç”¨ï¼ˆé“¶è¡Œï¼‰` | `éœ€é¢‘ç¹ç™»å½•ï¼Œä½“éªŒä¸€èˆ¬` | `å†…å­˜å ç”¨å°‘` |
| `15åˆ†é’Ÿ` | `ä¸€èˆ¬ä¼ä¸šåº”ç”¨` | `å¹³è¡¡å®‰å…¨æ€§å’Œä¾¿åˆ©æ€§` | `é€‚ä¸­` |
| `30åˆ†é’Ÿ` | `å¤§å¤šæ•°ç½‘ç«™ï¼ˆé»˜è®¤ï¼‰` | `ç”¨æˆ·å‹å¥½` | `é€‚ä¸­` |
| `60åˆ†é’Ÿ` | `åŠå…¬ç³»ç»Ÿï¼Œé•¿æ—¶é—´æ“ä½œ` | `å¾ˆä¾¿åˆ©` | `å†…å­˜å ç”¨å¤š` |
| `0æˆ–è´Ÿæ•°` | `Sessionæ°¸ä¸è¿‡æœŸ` | `æœ€æ–¹ä¾¿ä½†ä¸å®‰å…¨` | `å†…å­˜æŒç»­å¢é•¿` |

### 1.4 é…ç½®ç¤ºä¾‹ä¸å®é™…åº”ç”¨


**ç”µå•†ç½‘ç«™é…ç½®ç¤ºä¾‹**ï¼š
```xml
<session-config>
    <!-- è´­ç‰©è½¦Sessionä¿æŒ60åˆ†é’Ÿ -->
    <session-timeout>60</session-timeout>
    
    <!-- Cookieé…ç½® -->
    <cookie-config>
        <name>JSESSIONID</name>
        <http-only>true</http-only>
        <secure>true</secure>
    </cookie-config>
</session-config>
```

**ä¼ä¸šç®¡ç†ç³»ç»Ÿé…ç½®**ï¼š
```xml
<session-config>
    <!-- åŠå…¬ç³»ç»Ÿç”¨æˆ·å¯èƒ½éœ€è¦é•¿æ—¶é—´æ“ä½œ -->
    <session-timeout>120</session-timeout>
</session-config>
```

---

## 2. ğŸ’» ç¨‹åºåŠ¨æ€è®¾ç½®Session


### 2.1 ä¸ºä»€ä¹ˆéœ€è¦ç¨‹åºåŠ¨æ€è®¾ç½®


**ç°å®åœºæ™¯ç†è§£**ï¼š
å°±åƒå•†åœºé‡Œä¸åŒç±»å‹çš„é¡¾å®¢éœ€è¦ä¸åŒçš„æœåŠ¡æ—¶é—´ï¼š
- æ™®é€šé¡¾å®¢ï¼šé€›30åˆ†é’Ÿå°±å¤Ÿäº†
- VIPä¼šå‘˜ï¼šå¯èƒ½éœ€è¦2å°æ—¶çš„ä¸“å±æœåŠ¡
- æ€¥åŒ†åŒ†çš„é¡¾å®¢ï¼š10åˆ†é’Ÿå°±è¦ç»“è´¦ç¦»å¼€

åœ¨Webåº”ç”¨ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸åŒç”¨æˆ·ã€ä¸åŒæ“ä½œåœºæ™¯éœ€è¦ä¸åŒçš„Sessionè¶…æ—¶æ—¶é—´ã€‚

### 2.2 åŠ¨æ€è®¾ç½®Sessionè¶…æ—¶æ—¶é—´


**æ ¸å¿ƒæ–¹æ³•**ï¼š`setMaxInactiveInterval(int seconds)`

**åŸºç¡€ç”¨æ³•**ï¼š
```java
// åœ¨Servletä¸­åŠ¨æ€è®¾ç½®Sessionè¶…æ—¶
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) {
        
        String userType = request.getParameter("userType");
        HttpSession session = request.getSession();
        
        // æ ¹æ®ç”¨æˆ·ç±»å‹è®¾ç½®ä¸åŒè¶…æ—¶æ—¶é—´
        if ("vip".equals(userType)) {
            // VIPç”¨æˆ·ï¼š2å°æ—¶ä¸è¶…æ—¶
            session.setMaxInactiveInterval(2 * 60 * 60);
        } else if ("admin".equals(userType)) {
            // ç®¡ç†å‘˜ï¼š8å°æ—¶ä¸è¶…æ—¶
            session.setMaxInactiveInterval(8 * 60 * 60);
        } else {
            // æ™®é€šç”¨æˆ·ï¼š30åˆ†é’Ÿè¶…æ—¶
            session.setMaxInactiveInterval(30 * 60);
        }
        
        session.setAttribute("user", userType);
    }
}
```

### 2.3 åŠ¨æ€è®¾ç½®çš„å®é™…åº”ç”¨åœºæ™¯


**åœºæ™¯ä¸€ï¼šæ ¹æ®ç”¨æˆ·ç­‰çº§è®¾ç½®**
```java
public class UserSessionManager {
    
    public static void setSessionTimeout(HttpSession session, String userLevel) {
        switch (userLevel) {
            case "BRONZE":
                session.setMaxInactiveInterval(15 * 60); // 15åˆ†é’Ÿ
                break;
            case "SILVER":
                session.setMaxInactiveInterval(30 * 60); // 30åˆ†é’Ÿ
                break;
            case "GOLD":
                session.setMaxInactiveInterval(60 * 60); // 1å°æ—¶
                break;
            case "PLATINUM":
                session.setMaxInactiveInterval(2 * 60 * 60); // 2å°æ—¶
                break;
            default:
                session.setMaxInactiveInterval(10 * 60); // 10åˆ†é’Ÿ
        }
    }
}
```

**åœºæ™¯äºŒï¼šæ ¹æ®æ“ä½œç±»å‹è®¾ç½®**
```java
@WebServlet("/operation")
public class OperationServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) {
        
        String operation = request.getParameter("operation");
        HttpSession session = request.getSession();
        
        if ("fileUpload".equals(operation)) {
            // æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼šå»¶é•¿åˆ°2å°æ—¶
            session.setMaxInactiveInterval(2 * 60 * 60);
        } else if ("dataExport".equals(operation)) {
            // æ•°æ®å¯¼å‡ºæ“ä½œï¼šå»¶é•¿åˆ°1å°æ—¶
            session.setMaxInactiveInterval(60 * 60);
        } else {
            // æ™®é€šæ“ä½œï¼šæ¢å¤é»˜è®¤30åˆ†é’Ÿ
            session.setMaxInactiveInterval(30 * 60);
        }
    }
}
```

### 2.4 è·å–Sessionè¶…æ—¶ä¿¡æ¯


**æŸ¥çœ‹å½“å‰è¶…æ—¶è®¾ç½®**ï¼š
```java
public class SessionInfoServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        HttpSession session = request.getSession();
        PrintWriter out = response.getWriter();
        
        // è·å–æœ€å¤§ä¸æ´»è·ƒé—´éš”ï¼ˆç§’ï¼‰
        int maxInactiveInterval = session.getMaxInactiveInterval();
        
        // è·å–åˆ›å»ºæ—¶é—´
        long creationTime = session.getCreationTime();
        
        // è·å–æœ€åè®¿é—®æ—¶é—´
        long lastAccessedTime = session.getLastAccessedTime();
        
        // è®¡ç®—å‰©ä½™æ—¶é—´
        long currentTime = System.currentTimeMillis();
        long remainingTime = maxInactiveInterval * 1000 - 
                           (currentTime - lastAccessedTime);
        
        out.println("Sessionä¿¡æ¯ï¼š");
        out.println("æœ€å¤§ä¸æ´»è·ƒæ—¶é—´: " + maxInactiveInterval + " ç§’");
        out.println("å‰©ä½™æ—¶é—´: " + (remainingTime / 1000) + " ç§’");
    }
}
```

---

## 3. âš¡ Sessionæ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 3.1 Sessionæ€§èƒ½é—®é¢˜çš„æ ¹æº


**å½¢è±¡æ¯”å–»**ï¼š
æƒ³è±¡ä¸€ä¸ªå›¾ä¹¦é¦†çš„å‚¨ç‰©æŸœç³»ç»Ÿï¼š
- æ¯ä¸ªç”¨æˆ·æ¥å›¾ä¹¦é¦†éƒ½ä¼šåˆ†é…ä¸€ä¸ªå‚¨ç‰©æŸœï¼ˆSessionï¼‰
- å‚¨ç‰©æŸœé‡Œæ”¾ç€ç”¨æˆ·çš„ä¸ªäººç‰©å“ï¼ˆSessionæ•°æ®ï¼‰
- å¦‚æœå‚¨ç‰©æŸœå¤ªå¤šã€ä¸œè¥¿å¤ªå¤šï¼Œç®¡ç†å‘˜å°±å¿™ä¸è¿‡æ¥äº†

**æŠ€æœ¯å±‚é¢çš„é—®é¢˜**ï¼š
```
æ€§èƒ½é—®é¢˜æ¥æºï¼š
ğŸ”¸ Sessionæ•°é‡è¿‡å¤šï¼šåŒæ—¶åœ¨çº¿ç”¨æˆ·å¤ªå¤š
ğŸ”¸ Sessionæ•°æ®è¿‡å¤§ï¼šå•ä¸ªSessionå­˜å‚¨çš„æ•°æ®å¤ªå¤š
ğŸ”¸ Sessionè¶…æ—¶æ—¶é—´è¿‡é•¿ï¼šå ç”¨å†…å­˜æ—¶é—´å¤ªä¹…
ğŸ”¸ é¢‘ç¹çš„Sessionåˆ›å»ºå’Œé”€æ¯ï¼šå¢åŠ æœåŠ¡å™¨è´Ÿæ‹…
```

### 3.2 Sessionæ•°é‡æ§åˆ¶ç­–ç•¥


**ç­–ç•¥ä¸€ï¼šåˆç†è®¾ç½®è¶…æ—¶æ—¶é—´**
```java
// æ ¹æ®ä¸šåŠ¡åœºæ™¯è®¾ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´
public class SessionTimeoutManager {
    
    // ä¸åŒé¡µé¢è®¾ç½®ä¸åŒè¶…æ—¶æ—¶é—´
    public static void setTimeoutByPage(HttpSession session, String page) {
        switch (page) {
            case "login":
            case "register":
                // ç™»å½•æ³¨å†Œé¡µé¢ï¼šçŸ­è¶…æ—¶
                session.setMaxInactiveInterval(5 * 60);
                break;
                
            case "shopping":
                // è´­ç‰©é¡µé¢ï¼šä¸­ç­‰è¶…æ—¶
                session.setMaxInactiveInterval(30 * 60);
                break;
                
            case "checkout":
                // ç»“ç®—é¡µé¢ï¼šé•¿è¶…æ—¶
                session.setMaxInactiveInterval(60 * 60);
                break;
        }
    }
}
```

**ç­–ç•¥äºŒï¼šä¸»åŠ¨æ¸…ç†æ— ç”¨Session**
```java
@WebListener
public class SessionCleanupListener implements HttpSessionListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        // Sessionåˆ›å»ºæ—¶çš„å¤„ç†
        System.out.println("æ–°Sessionåˆ›å»º: " + se.getSession().getId());
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        // Sessioné”€æ¯æ—¶çš„æ¸…ç†å·¥ä½œ
        HttpSession session = se.getSession();
        
        // æ¸…ç†Sessionä¸­çš„å¤§å¯¹è±¡
        session.removeAttribute("largeData");
        session.removeAttribute("fileBuffer");
        
        System.out.println("Sessionå·²é”€æ¯: " + session.getId());
    }
}
```

### 3.3 Sessionæ•°æ®ä¼˜åŒ–


**åŸåˆ™ï¼šSessionä¸­åªå­˜å¿…éœ€çš„å°æ•°æ®**

**âŒ ä¸å¥½çš„åšæ³•**ï¼š
```java
// åœ¨Sessionä¸­å­˜å‚¨å¤§é‡æ•°æ®
session.setAttribute("userDetailInfo", largeUserObject);
session.setAttribute("productList", allProductsList);  // å¯èƒ½æœ‰å‡ åƒæ¡æ•°æ®
session.setAttribute("fileContent", fileByteArray);    // æ–‡ä»¶å†…å®¹
```

**âœ… å¥½çš„åšæ³•**ï¼š
```java
// åªåœ¨Sessionä¸­å­˜å‚¨å…³é”®æ ‡è¯†
session.setAttribute("userId", user.getId());
session.setAttribute("userRole", user.getRole());
session.setAttribute("loginTime", System.currentTimeMillis());

// å¤§æ•°æ®é€šè¿‡IDå»æ•°æ®åº“æŸ¥è¯¢
public User getUserInfo(HttpSession session) {
    Integer userId = (Integer) session.getAttribute("userId");
    if (userId != null) {
        return userService.findById(userId);  // ä»æ•°æ®åº“æŸ¥è¯¢
    }
    return null;
}
```

### 3.4 Sessionå­˜å‚¨ä¼˜åŒ–


**å†…å­˜å­˜å‚¨ vs å¤–éƒ¨å­˜å‚¨**ï¼š

```
Sessionå­˜å‚¨æ–¹å¼å¯¹æ¯”ï¼š

å†…å­˜å­˜å‚¨ï¼ˆé»˜è®¤ï¼‰ï¼š
âœ… è®¿é—®é€Ÿåº¦å¿«
âŒ æœåŠ¡å™¨é‡å¯åä¸¢å¤±
âŒ å ç”¨æœåŠ¡å™¨å†…å­˜
âŒ æ— æ³•é›†ç¾¤å…±äº«

å¤–éƒ¨å­˜å‚¨ï¼ˆRedis/æ•°æ®åº“ï¼‰ï¼š
âœ… æ•°æ®æŒä¹…åŒ–
âœ… æ”¯æŒé›†ç¾¤å…±äº«
âœ… ä¸å ç”¨åº”ç”¨æœåŠ¡å™¨å†…å­˜
âŒ è®¿é—®é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢
```

**é…ç½®å¤–éƒ¨Sessionå­˜å‚¨ç¤ºä¾‹**ï¼š
```xml
<!-- åœ¨context.xmlä¸­é…ç½®Redis Sessionå­˜å‚¨ -->
<Context>
    <Manager className="org.redisson.tomcat.RedissonSessionManager"
             configPath="${catalina.base}/conf/redisson.conf" />
</Context>
```

---

## 4. ğŸ’¾ å†…å­˜ä½¿ç”¨æ§åˆ¶ä¸ç›‘æ§


### 4.1 Sessionå†…å­˜å ç”¨åˆ†æ


**å†…å­˜è®¡ç®—å…¬å¼**ï¼š
```
Sessionæ€»å†…å­˜å ç”¨ = Sessionæ•°é‡ Ã— æ¯ä¸ªSessionçš„å¹³å‡å¤§å°

å®é™…ä¾‹å­ï¼š
- åŒæ—¶åœ¨çº¿ç”¨æˆ·ï¼š10,000äºº
- æ¯ä¸ªSessionå¹³å‡å¤§å°ï¼š2KB
- æ€»å†…å­˜å ç”¨ï¼š10,000 Ã— 2KB = 20MB

å¦‚æœæ¯ä¸ªSessionæ˜¯20KBï¼š
- æ€»å†…å­˜å ç”¨ï¼š10,000 Ã— 20KB = 200MB
```

### 4.2 Sessionå¤§å°ç›‘æ§


**ç›‘æ§Sessionå¤§å°çš„å·¥å…·ç±»**ï¼š
```java
public class SessionSizeMonitor {
    
    // è®¡ç®—Sessionä¸­æ‰€æœ‰å±æ€§çš„å¤§å°
    public static long calculateSessionSize(HttpSession session) {
        long totalSize = 0;
        
        Enumeration<String> attributeNames = session.getAttributeNames();
        while (attributeNames.hasMoreElements()) {
            String name = attributeNames.nextElement();
            Object value = session.getAttribute(name);
            
            if (value != null) {
                long size = getObjectSize(value);
                totalSize += size;
                
                // å¦‚æœå•ä¸ªå±æ€§è¿‡å¤§ï¼Œè®°å½•è­¦å‘Š
                if (size > 50 * 1024) { // å¤§äº50KB
                    System.out.println("è­¦å‘Šï¼šSessionå±æ€§ " + name + 
                                     " å ç”¨å†…å­˜è¿‡å¤§ï¼š" + size + " å­—èŠ‚");
                }
            }
        }
        
        return totalSize;
    }
    
    // ç®€å•çš„å¯¹è±¡å¤§å°ä¼°ç®—
    private static long getObjectSize(Object obj) {
        if (obj instanceof String) {
            return ((String) obj).length() * 2; // æ¯ä¸ªå­—ç¬¦2å­—èŠ‚
        } else if (obj instanceof Integer) {
            return 4;
        } else if (obj instanceof Long) {
            return 8;
        } else {
            // å¤æ‚å¯¹è±¡å¯ä»¥ç”¨åºåˆ—åŒ–æ–¹å¼è®¡ç®—
            return estimateByName(obj);
        }
    }
    
    private static long estimateByName(Object obj) {
        // ç®€åŒ–ä¼°ç®—ï¼šæ ¹æ®ç±»åä¼°ç®—
        return obj.getClass().getName().length() * 2 + 100;
    }
}
```

### 4.3 å†…å­˜ä½¿ç”¨æ§åˆ¶ç­–ç•¥


**ç­–ç•¥ä¸€ï¼šè®¾ç½®Sessionæ•°æ®å¤§å°é™åˆ¶**
```java
public class SessionDataController {
    
    private static final long MAX_SESSION_SIZE = 100 * 1024; // 100KBé™åˆ¶
    
    public static boolean addAttribute(HttpSession session, 
                                     String name, Object value) {
        
        // è®¡ç®—æ·»åŠ åçš„æ€»å¤§å°
        long currentSize = SessionSizeMonitor.calculateSessionSize(session);
        long valueSize = getObjectSize(value);
        
        if (currentSize + valueSize > MAX_SESSION_SIZE) {
            System.out.println("Sessionå¤§å°è¶…é™ï¼Œæ‹’ç»æ·»åŠ å±æ€§ï¼š" + name);
            return false;
        }
        
        session.setAttribute(name, value);
        return true;
    }
}
```

**ç­–ç•¥äºŒï¼šå®šæœŸæ¸…ç†Sessionæ•°æ®**
```java
@Component
public class SessionCleanupScheduler {
    
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void cleanupSessions() {
        // è·å–æ‰€æœ‰æ´»è·ƒSessionï¼ˆå®é™…å®ç°éœ€è¦Sessionç®¡ç†å™¨æ”¯æŒï¼‰
        List<HttpSession> activeSessions = getActiveSessions();
        
        for (HttpSession session : activeSessions) {
            cleanupSessionData(session);
        }
    }
    
    private void cleanupSessionData(HttpSession session) {
        // æ¸…ç†è¿‡æœŸçš„ä¸´æ—¶æ•°æ®
        Long uploadTime = (Long) session.getAttribute("fileUploadTime");
        if (uploadTime != null && 
            System.currentTimeMillis() - uploadTime > 3600000) { // 1å°æ—¶åæ¸…ç†
            session.removeAttribute("uploadedFile");
            session.removeAttribute("fileUploadTime");
        }
        
        // æ¸…ç†è¿‡å¤§çš„ç¼“å­˜æ•°æ®
        if (SessionSizeMonitor.calculateSessionSize(session) > 200 * 1024) {
            session.removeAttribute("tempData");
            session.removeAttribute("cachedResult");
        }
    }
}
```

### 4.4 JVMå†…å­˜ç›‘æ§


**ç›‘æ§Sessionå ç”¨çš„JVMå†…å­˜**ï¼š
```java
public class MemoryMonitor {
    
    public static void printMemoryInfo() {
        Runtime runtime = Runtime.getRuntime();
        
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        long usedMemory = totalMemory - freeMemory;
        long maxMemory = runtime.maxMemory();
        
        System.out.println("=== å†…å­˜ä½¿ç”¨æƒ…å†µ ===");
        System.out.println("å·²ç”¨å†…å­˜: " + formatBytes(usedMemory));
        System.out.println("ç©ºé—²å†…å­˜: " + formatBytes(freeMemory));
        System.out.println("æ€»å†…å­˜: " + formatBytes(totalMemory));
        System.out.println("æœ€å¤§å†…å­˜: " + formatBytes(maxMemory));
        System.out.println("å†…å­˜ä½¿ç”¨ç‡: " + 
                          (usedMemory * 100 / totalMemory) + "%");
    }
    
    private static String formatBytes(long bytes) {
        if (bytes < 1024) return bytes + " B";
        if (bytes < 1024 * 1024) return (bytes / 1024) + " KB";
        return (bytes / (1024 * 1024)) + " MB";
    }
}
```

---

## 5. ğŸ“‹ Sessioné…ç½®æœ€ä½³å®è·µ


### 5.1 ä¸åŒåº”ç”¨åœºæ™¯çš„é…ç½®å»ºè®®


**ç”µå•†ç½‘ç«™é…ç½®**ï¼š
```xml
<session-config>
    <!-- è´­ç‰©è½¦éœ€è¦è¾ƒé•¿æ—¶é—´ -->
    <session-timeout>60</session-timeout>
    
    <cookie-config>
        <name>SHOP_SESSION</name>
        <http-only>true</http-only>
        <secure>true</secure>
        <max-age>3600</max-age>
    </cookie-config>
</session-config>
```

**ä¼ä¸šå†…éƒ¨ç³»ç»Ÿé…ç½®**ï¼š
```xml
<session-config>
    <!-- åŠå…¬æ—¶é—´å†…ä¸è¶…æ—¶ -->
    <session-timeout>480</session-timeout>
    
    <cookie-config>
        <name>OFFICE_SESSION</name>
        <http-only>true</http-only>
        <secure>true</secure>
    </cookie-config>
</session-config>
```

**é‡‘èç³»ç»Ÿé…ç½®**ï¼š
```xml
<session-config>
    <!-- å®‰å…¨è¦æ±‚é«˜ï¼ŒçŸ­è¶…æ—¶ -->
    <session-timeout>15</session-timeout>
    
    <cookie-config>
        <name>BANK_SESSION</name>
        <http-only>true</http-only>
        <secure>true</secure>
        <same-site>Strict</same-site>
    </cookie-config>
</session-config>
```

### 5.2 æ€§èƒ½è°ƒä¼˜å»ºè®®


**è°ƒä¼˜æ£€æŸ¥æ¸…å•**ï¼š
```
âœ… Sessionè¶…æ—¶æ—¶é—´è®¾ç½®åˆç†
âœ… Sessionä¸­åªå­˜å‚¨å¿…è¦æ•°æ®
âœ… å®šæœŸç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
âœ… é…ç½®åˆé€‚çš„åƒåœ¾å›æ”¶å‚æ•°
âœ… è€ƒè™‘ä½¿ç”¨å¤–éƒ¨Sessionå­˜å‚¨
âœ… å®ç°Sessionæ•°æ®å‹ç¼©
âœ… è®¾ç½®åˆç†çš„å¹¶å‘è¿æ¥æ•°é™åˆ¶
```

### 5.3 å®‰å…¨é…ç½®å»ºè®®


**å®‰å…¨åŠ å›ºé…ç½®**ï¼š
```xml
<session-config>
    <session-timeout>30</session-timeout>
    
    <cookie-config>
        <!-- é˜²æ­¢JavaScriptè®¿é—® -->
        <http-only>true</http-only>
        
        <!-- HTTPSä¼ è¾“ -->
        <secure>true</secure>
        
        <!-- é˜²æ­¢CSRFæ”»å‡» -->
        <same-site>Strict</same-site>
        
        <!-- è‡ªå®šä¹‰Sessionåç§° -->
        <name>APP_SESSION_ID</name>
    </cookie-config>
    
    <!-- URLé‡å†™è¿½è¸ªæ¨¡å¼ç¦ç”¨ï¼Œåªä½¿ç”¨Cookie -->
    <tracking-mode>COOKIE</tracking-mode>
</session-config>
```

---

## 6. ğŸ“ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Sessionè¶…æ—¶ï¼šé•¿æ—¶é—´ä¸æ“ä½œè‡ªåŠ¨æ¸…ç†ä¼šè¯
ğŸ”¸ web.xmlé…ç½®ï¼šä½¿ç”¨session-timeoutæ ‡ç­¾è®¾ç½®å…¨å±€è¶…æ—¶
ğŸ”¸ ç¨‹åºåŠ¨æ€è®¾ç½®ï¼šsetMaxInactiveInterval()æ–¹æ³•åŠ¨æ€è°ƒæ•´
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæ§åˆ¶Sessionæ•°é‡å’Œå•ä¸ªSessionå¤§å°
ğŸ”¸ å†…å­˜ç›‘æ§ï¼šå®šæœŸæ£€æŸ¥Sessionå†…å­˜å ç”¨æƒ…å†µ
```

### 6.2 å…³é”®é…ç½®è¦ç‚¹


**è¶…æ—¶æ—¶é—´é€‰æ‹©åŸåˆ™**ï¼š
```
ä¸šåŠ¡ç±»å‹          æ¨èè¶…æ—¶æ—¶é—´    è¯´æ˜
é«˜å®‰å…¨æ€§åº”ç”¨      5-15åˆ†é’Ÿ       é“¶è¡Œã€æ”¯ä»˜ç³»ç»Ÿ
ä¸€èˆ¬å•†ä¸šç½‘ç«™      30-60åˆ†é’Ÿ      ç”µå•†ã€èµ„è®¯ç½‘ç«™
åŠå…¬ç³»ç»Ÿ          2-8å°æ—¶        ä¼ä¸šå†…éƒ¨åº”ç”¨  
é•¿æ—¶é—´æ“ä½œ        æ ¹æ®éœ€æ±‚è°ƒæ•´    æ–‡ä»¶ä¸Šä¼ ã€æ•°æ®å¤„ç†
```

**æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹**ï¼š
```
æ•°æ®å­˜å‚¨ï¼šSessionä¸­åªå­˜IDï¼Œå¤§æ•°æ®æŸ¥æ•°æ®åº“
è¶…æ—¶è®¾ç½®ï¼šæ ¹æ®ç”¨æˆ·ç±»å‹å’Œæ“ä½œç±»å‹åŠ¨æ€è°ƒæ•´
å†…å­˜æ§åˆ¶ï¼šå®šæœŸæ¸…ç†ã€å¤§å°é™åˆ¶ã€å¤–éƒ¨å­˜å‚¨
ç›‘æ§é¢„è­¦ï¼šå†…å­˜ä½¿ç”¨ç‡ã€Sessionæ•°é‡ã€å¤§å°ç»Ÿè®¡
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**å¼€å‘å®è·µæŒ‡å¯¼**ï¼š
- æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
- ä½¿ç”¨åŠ¨æ€é…ç½®é€‚åº”ä¸åŒåœºæ™¯
- å®šæœŸç›‘æ§å’Œä¼˜åŒ–Sessionä½¿ç”¨
- æ³¨æ„å®‰å…¨æ€§é…ç½®é˜²æ­¢æ”»å‡»

**è¿ç»´ç›‘æ§è¦ç‚¹**ï¼š
- ç›‘æ§åŒæ—¶åœ¨çº¿Sessionæ•°é‡
- æ£€æŸ¥å•ä¸ªSessionå¤§å°æ˜¯å¦åˆç†
- è§‚å¯Ÿå†…å­˜ä½¿ç”¨è¶‹åŠ¿
- è®¾ç½®å‘Šè­¦é˜ˆå€¼é˜²æ­¢å†…å­˜æº¢å‡º

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Sessioné…ç½®æœ‰æŠ€å·§ï¼Œè¶…æ—¶è®¾ç½®è¦åˆç†
ç¨‹åºåŠ¨æ€å¯è°ƒèŠ‚ï¼Œä¸åŒåœºæ™¯ä¸åŒç­–ç•¥
å†…å­˜ç›‘æ§å¾ˆé‡è¦ï¼Œå¤§å°æ§åˆ¶æ€§èƒ½å¥½
å®‰å…¨é…ç½®ä¸èƒ½å¿˜ï¼ŒCookieè®¾ç½®è¦åŠ å¼º
```