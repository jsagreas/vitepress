---
title: 2ã€Sessionè·å–ä¸åˆ›å»º
---
## ğŸ“š ç›®å½•

1. [SessionåŸºç¡€æ¦‚å¿µå›é¡¾](#1-sessionåŸºç¡€æ¦‚å¿µå›é¡¾)
2. [getSession()æ–¹æ³•è¯¦è§£](#2-getsessionæ–¹æ³•è¯¦è§£)
3. [Sessionåˆ›å»ºè¿‡ç¨‹æ·±å…¥](#3-sessionåˆ›å»ºè¿‡ç¨‹æ·±å…¥)
4. [SessionIDä¼ é€’æœºåˆ¶](#4-sessionidä¼ é€’æœºåˆ¶)
5. [å®é™…åº”ç”¨åœºæ™¯](#5-å®é™…åº”ç”¨åœºæ™¯)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ SessionåŸºç¡€æ¦‚å¿µå›é¡¾


### 1.1 ä»€ä¹ˆæ˜¯Session


**ç®€å•ç†è§£**ï¼šSessionå°±åƒé“¶è¡Œç»™ä½ çš„**è´¦æˆ·å·ç **ï¼Œæ¯æ¬¡ä½ æ¥é“¶è¡ŒåŠäº‹ï¼Œé“¶è¡Œé€šè¿‡è¿™ä¸ªå·ç å°±çŸ¥é“ä½ æ˜¯è°ï¼Œä½ æœ‰ä»€ä¹ˆä¸šåŠ¡è®°å½•ã€‚

```
ç”¨æˆ·è®¿é—®ç½‘ç«™çš„è¿‡ç¨‹ï¼š
ç¬¬ä¸€æ¬¡è®¿é—® â†’ ç½‘ç«™åˆ†é…Session â†’ åç»­è®¿é—®éƒ½ç”¨è¿™ä¸ªSession â†’ å…³é—­æµè§ˆå™¨Sessionå¤±æ•ˆ

å°±åƒï¼š
ç¬¬ä¸€æ¬¡å»é“¶è¡Œ â†’ é“¶è¡Œç»™ä½ å¼€æˆ· â†’ ä»¥åæ¯æ¬¡éƒ½ç”¨è´¦æˆ·å· â†’ é”€æˆ·åè´¦æˆ·å¤±æ•ˆ
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **è¯†åˆ«ç”¨æˆ·**ï¼šåŒºåˆ†ä¸åŒç”¨æˆ·çš„è®¿é—®
- ğŸ”¸ **è®°å½•çŠ¶æ€**ï¼šä¿å­˜ç”¨æˆ·åœ¨ç½‘ç«™ä¸Šçš„æ“ä½œä¿¡æ¯
- ğŸ”¸ **æ•°æ®å…±äº«**ï¼šåœ¨å¤šä¸ªé¡µé¢é—´å…±äº«ç”¨æˆ·æ•°æ®

### 1.2 Sessionä¸HTTPçš„å…³ç³»


**ä¸ºä»€ä¹ˆéœ€è¦Session**ï¼Ÿ

HTTPåè®®æ˜¯**"å¥å¿˜çš„"**åè®®ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæœåŠ¡å™¨ä¸çŸ¥é“è¿™æ¬¡è¯·æ±‚å’Œä¸Šæ¬¡è¯·æ±‚æ˜¯ä¸æ˜¯åŒä¸€ä¸ªäººå‘çš„ã€‚

```
æ²¡æœ‰Sessionçš„æƒ…å†µï¼š
ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨ï¼šæ¬¢è¿å¼ ä¸‰
ç”¨æˆ·æµè§ˆå•†å“ â†’ æœåŠ¡å™¨ï¼šä½ æ˜¯è°ï¼Ÿæˆ‘ä¸è®¤è¯†ä½ 
ç”¨æˆ·ä¸‹å• â†’ æœåŠ¡å™¨ï¼šä½ æ˜¯è°ï¼Ÿæˆ‘ä¸è®¤è¯†ä½ 

æœ‰Sessionçš„æƒ…å†µï¼š
ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨ï¼šæ¬¢è¿å¼ ä¸‰ï¼Œç»™ä½ Session123
ç”¨æˆ·æµè§ˆå•†å“ â†’ æœåŠ¡å™¨ï¼šSession123ï¼Œä½ æ˜¯å¼ ä¸‰ï¼Œç»§ç»­æµè§ˆ
ç”¨æˆ·ä¸‹å• â†’ æœåŠ¡å™¨ï¼šSession123ï¼Œä½ æ˜¯å¼ ä¸‰ï¼Œè®¢å•å·²ç”Ÿæˆ
```

---

## 2. ğŸ“– getSession()æ–¹æ³•è¯¦è§£


### 2.1 getSession()åŸºæœ¬ç”¨æ³•


**`HttpServletRequest.getSession()`** æ˜¯è·å–Sessionçš„æ ¸å¿ƒæ–¹æ³•ï¼Œå°±åƒä½ å»é“¶è¡ŒåŠäº‹æ—¶æŠ¥è´¦æˆ·å·ä¸€æ ·ã€‚

**åŸºæœ¬è¯­æ³•**ï¼š
```java
HttpSession session = request.getSession();
```

**è¿™è¡Œä»£ç åšäº†ä»€ä¹ˆ**ï¼Ÿ
1. **å…ˆæ‰¾**ï¼šæ£€æŸ¥æ˜¯å¦å·²ç»æœ‰Sessionå­˜åœ¨
2. **æ²¡æœ‰å°±åˆ›å»º**ï¼šå¦‚æœæ²¡æœ‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„
3. **è¿”å›Session**ï¼šæŠŠSessionå¯¹è±¡ç»™ä½ ä½¿ç”¨

### 2.2 getSession()ä¸getSession(false)çš„åŒºåˆ«


è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«å°±åƒ**é“¶è¡ŒåŠäº‹çš„ä¸¤ç§æ–¹å¼**ï¼š

**getSession() - "æ²¡è´¦æˆ·å°±å¼€æˆ·"æ¨¡å¼**
```java
HttpSession session = request.getSession();
// ç›¸å½“äºï¼šå¦‚æœæˆ‘æœ‰è´¦æˆ·å°±ç”¨ç°æœ‰çš„ï¼Œæ²¡æœ‰å°±ç»™æˆ‘å¼€ä¸ªæ–°è´¦æˆ·
```

**getSession(false) - "åªç”¨ç°æœ‰è´¦æˆ·"æ¨¡å¼**  
```java
HttpSession session = request.getSession(false);
// ç›¸å½“äºï¼šå¦‚æœæˆ‘æœ‰è´¦æˆ·å°±ç”¨ç°æœ‰çš„ï¼Œæ²¡æœ‰å°±ç®—äº†ï¼Œä¸è¦å¼€æ–°çš„
```

| æ–¹æ³• | **æœ‰Sessionæ—¶** | **æ²¡æœ‰Sessionæ—¶** | **è¿”å›å€¼** |
|------|----------------|------------------|------------|
| `getSession()` | `è¿”å›ç°æœ‰Session` | `åˆ›å»ºæ–°Sessionå¹¶è¿”å›` | `æ°¸è¿œä¸ä¸ºnull` |
| `getSession(false)` | `è¿”å›ç°æœ‰Session` | `ä¸åˆ›å»ºï¼Œç›´æ¥è¿”å›null` | `å¯èƒ½ä¸ºnull` |

### 2.3 å®é™…åº”ç”¨åœºæ™¯å¯¹æ¯”


**åœºæ™¯1ï¼šç”¨æˆ·ç™»å½•**
```java
// ç™»å½•æ—¶ï¼Œéœ€è¦åˆ›å»ºSessionå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
HttpSession session = request.getSession(); // ç”¨getSession()
session.setAttribute("username", "å¼ ä¸‰");
session.setAttribute("userId", 100);
```

**åœºæ™¯2ï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€**
```java
// æ£€æŸ¥æ—¶ï¼Œä¸éœ€è¦åˆ›å»ºæ–°Sessionï¼Œåªæ£€æŸ¥ç°æœ‰çš„
HttpSession session = request.getSession(false); // ç”¨getSession(false)
if (session == null) {
    // æ²¡æœ‰Sessionï¼Œç”¨æˆ·æœªç™»å½•
    response.sendRedirect("login.jsp");
    return;
}
String username = (String) session.getAttribute("username");
if (username == null) {
    // æœ‰Sessionä½†æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œä¹Ÿç®—æœªç™»å½•
    response.sendRedirect("login.jsp");
}
```

### 2.4 ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸¤ç§æ–¹å¼ï¼Ÿ


**æ€§èƒ½è€ƒè™‘**ï¼šåˆ›å»ºSessionéœ€è¦æ¶ˆè€—æœåŠ¡å™¨èµ„æº

```
è®¿é—®é¦–é¡µæ—¶ï¼š
- ç”¨getSession(false) â†’ åªæ˜¯çœ‹çœ‹ç”¨æˆ·æ˜¯å¦ç™»å½•
- ä¸éœ€è¦ä¸ºæ¯ä¸ªè®¿é—®è€…éƒ½åˆ›å»ºSession

ç”¨æˆ·ç™»å½•æ—¶ï¼š
- ç”¨getSession() â†’ ç¡®å®éœ€è¦åˆ›å»ºSessionå­˜å‚¨ç™»å½•ä¿¡æ¯
```

---

## 3. ğŸ—ï¸ Sessionåˆ›å»ºè¿‡ç¨‹æ·±å…¥


### 3.1 Sessionåˆ›å»ºçš„å®Œæ•´æµç¨‹


å½“ä½ ç¬¬ä¸€æ¬¡è°ƒç”¨ `getSession()` æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

```
Sessionåˆ›å»ºæµç¨‹å›¾ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ æœåŠ¡å™¨æ£€æŸ¥Cookie â†’ æ²¡æœ‰SessionID â†’ åˆ›å»ºæ–°Session â†’ ç”ŸæˆSessionID â†’ è®¾ç½®Cookie â†’ è¿”å›Sessionå¯¹è±¡

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ç”¨æˆ·è¯·æ±‚   â”‚â”€â”€â”€â†’â”‚ æ£€æŸ¥æ˜¯å¦æœ‰ID  â”‚â”€â”€â”€â†’â”‚  åˆ›å»ºSession â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                    â”‚
                              â”‚æ— ID                â”‚
                              â–¼                    â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ ç”Ÿæˆæ–°çš„ID   â”‚â†â”€â”€â”€â”‚ å­˜å‚¨åˆ°æœåŠ¡å™¨ â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ å‘é€ç»™æµè§ˆå™¨  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Sessioné¦–æ¬¡åˆ›å»ºçš„è¯¦ç»†æ­¥éª¤


**æ­¥éª¤1ï¼šç”Ÿæˆå”¯ä¸€ID**
```
æœåŠ¡å™¨ç”Ÿæˆç±»ä¼¼è¿™æ ·çš„IDï¼šA1B2C3D4E5F6G7H8
è¿™ä¸ªIDåœ¨æ•´ä¸ªæœåŠ¡å™¨ä¸­æ˜¯å”¯ä¸€çš„ï¼Œå°±åƒèº«ä»½è¯å·ç ä¸€æ ·
```

**æ­¥éª¤2ï¼šåˆ›å»ºSessionå¯¹è±¡**
```java
// æœåŠ¡å™¨å†…éƒ¨å¤§è‡´æ˜¯è¿™æ ·åˆ›å»ºçš„ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
HttpSession session = new HttpSessionImpl();
session.setId("A1B2C3D4E5F6G7H8");
session.setCreationTime(System.currentTimeMillis());
```

**æ­¥éª¤3ï¼šå­˜å‚¨åˆ°æœåŠ¡å™¨**
```
æœåŠ¡å™¨çš„Sessionå­˜å‚¨ç±»ä¼¼äºï¼š
SessionID: A1B2C3D4E5F6G7H8 â†’ Sessionå¯¹è±¡{åˆ›å»ºæ—¶é—´ï¼Œç”¨æˆ·æ•°æ®...}
SessionID: B2C3D4E5F6G7H8I9 â†’ Sessionå¯¹è±¡{åˆ›å»ºæ—¶é—´ï¼Œç”¨æˆ·æ•°æ®...}
```

**æ­¥éª¤4ï¼šé€šçŸ¥æµè§ˆå™¨**
```
æœåŠ¡å™¨åœ¨HTTPå“åº”ä¸­æ·»åŠ ï¼š
Set-Cookie: JSESSIONID=A1B2C3D4E5F6G7H8; Path=/; HttpOnly
```

### 3.3 Sessionè‡ªåŠ¨ç”Ÿæˆæœºåˆ¶


**ä»€ä¹ˆæ—¶å€™è‡ªåŠ¨ç”ŸæˆSession**ï¼Ÿ

> ğŸ’¡ **é‡è¦ç†è§£**ï¼šåªæœ‰å½“ä½ **ä¸»åŠ¨è°ƒç”¨**`getSession()`æˆ–`getSession(true)`æ—¶ï¼ŒSessionæ‰ä¼šè¢«åˆ›å»ºï¼

**ä¸ä¼šè‡ªåŠ¨åˆ›å»ºçš„æƒ…å†µ**ï¼š
- ç”¨æˆ·è®¿é—®é™æ€é¡µé¢ï¼ˆhtmlã€cssã€jsã€å›¾ç‰‡ç­‰ï¼‰
- ç”¨æˆ·è®¿é—®Servletä½†Servletæ²¡æœ‰è°ƒç”¨getSession()
- ç”¨æˆ·è®¿é—®JSPä½†JSPè®¾ç½®äº†`<%@ page session="false" %>`

**ä¼šè‡ªåŠ¨åˆ›å»ºçš„æƒ…å†µ**ï¼š
- Servletä¸­è°ƒç”¨`request.getSession()`
- JSPé¡µé¢é»˜è®¤ä¼šè‡ªåŠ¨è·å–Sessionï¼ˆé™¤éæ˜ç¡®ç¦ç”¨ï¼‰

---

## 4. ğŸ”— SessionIDä¼ é€’æœºåˆ¶


### 4.1 SessionIDä¼ é€’æ–¹å¼æ¦‚è§ˆ


SessionIDå°±åƒ**å¿«é€’å•å·**ï¼Œéœ€è¦åœ¨ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´æ¥å›ä¼ é€’ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š

```
ä¼ é€’æ–¹å¼å¯¹æ¯”ï¼š
               ä¼˜ç‚¹              ç¼ºç‚¹              ä½¿ç”¨ç‡
Cookieæ–¹å¼    è‡ªåŠ¨ä¼ é€’ï¼Œç®€å•     ç”¨æˆ·å¯èƒ½ç¦ç”¨       95%
URLé‡å†™      ä¸ä¾èµ–Cookie      URLå˜é•¿ï¼Œå¤æ‚      5%
```

### 4.2 Cookieæ–¹å¼ä¼ é€’ï¼ˆä¸»æµæ–¹å¼ï¼‰


**å·¥ä½œåŸç†**ï¼šå°±åƒé“¶è¡Œç»™ä½ ä¸€å¼ **ä¼šå‘˜å¡**ï¼Œæ¯æ¬¡æ¥éƒ½å¸¦ç€è¿™å¼ å¡

**ç¬¬ä¸€æ¬¡è®¿é—®**ï¼š
```
1. ç”¨æˆ· â†’ æœåŠ¡å™¨: GET /login.jsp
2. æœåŠ¡å™¨åˆ›å»ºSession: ID=ABC123
3. æœåŠ¡å™¨ â†’ ç”¨æˆ·: Set-Cookie: JSESSIONID=ABC123
4. æµè§ˆå™¨ä¿å­˜Cookie
```

**åç»­è®¿é—®**ï¼š
```
1. ç”¨æˆ· â†’ æœåŠ¡å™¨: GET /welcome.jsp
   Cookie: JSESSIONID=ABC123
2. æœåŠ¡å™¨æ‰¾åˆ°IDä¸ºABC123çš„Session
3. è¿”å›å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯
```

**Cookieçš„ç‰¹ç‚¹**ï¼š
- ğŸ”¸ **è‡ªåŠ¨æºå¸¦**ï¼šæµè§ˆå™¨æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š
- ğŸ”¸ **é€æ˜ä¼ é€’**ï¼šå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨å¤„ç†
- ğŸ”¸ **æœ‰åŸŸåé™åˆ¶**ï¼šåªåœ¨åŒä¸€ä¸ªç½‘ç«™å†…æœ‰æ•ˆ

### 4.3 URLé‡å†™æ–¹å¼ä¼ é€’ï¼ˆå¤‡é€‰æ–¹å¼ï¼‰


å½“ç”¨æˆ·**ç¦ç”¨äº†Cookie**æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨URLé‡å†™ï¼Œå°±åƒæ¯æ¬¡éƒ½è¦**æ‰‹åŠ¨æŠ¥è´¦æˆ·å·**ã€‚

**åŸç†**ï¼šæŠŠSessionIDé™„åŠ åˆ°æ¯ä¸ªé“¾æ¥åé¢

**æ™®é€šé“¾æ¥**ï¼š
```
åŸå§‹é“¾æ¥: http://localhost:8080/welcome.jsp
é‡å†™å:   http://localhost:8080/welcome.jsp;jsessionid=ABC123
```

**ä»£ç å®ç°**ï¼š
```java
// å¯¹æ‰€æœ‰é“¾æ¥è¿›è¡Œé‡å†™
String url = "welcome.jsp";
String encodedURL = response.encodeURL(url);
// encodedURLå¯èƒ½æ˜¯: welcome.jsp;jsessionid=ABC123
```

**URLé‡å†™çš„ç¼ºç‚¹**ï¼š
- ğŸ”¸ **æ‰‹åŠ¨å¤„ç†**ï¼šéœ€è¦å¯¹æ¯ä¸ªé“¾æ¥éƒ½è°ƒç”¨encodeURL()
- ğŸ”¸ **URLå˜é•¿**ï¼šå½±å“ç¾è§‚
- ğŸ”¸ **å®¹æ˜“ä¸¢å¤±**ï¼šç”¨æˆ·å¤åˆ¶é“¾æ¥æ—¶å¯èƒ½ä¸¢å¤±SessionID

### 4.4 åŒé‡ä¿éšœæœºåˆ¶


ç°ä»£Webåº”ç”¨é€šå¸¸é‡‡ç”¨**åŒé‡ä¿éšœ**ï¼š

```java
// æ™ºèƒ½å¤„ç†SessionIDä¼ é€’
public void doGet(HttpServletRequest request, HttpServletResponse response) {
    HttpSession session = request.getSession();
    
    // ç”Ÿæˆé“¾æ¥æ—¶è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦URLé‡å†™
    String homeLink = response.encodeURL("home.jsp");
    String profileLink = response.encodeURL("profile.jsp");
    
    // å¦‚æœCookieå¯ç”¨ï¼ŒencodeURLè¿”å›åŸå§‹URL
    // å¦‚æœCookieä¸å¯ç”¨ï¼ŒencodeURLè¿”å›å¸¦SessionIDçš„URL
}
```

---

## 5. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 5.1 ç”¨æˆ·ç™»å½•ç³»ç»Ÿå®ç°


**ç™»å½•éªŒè¯æµç¨‹**ï¼š

```
ç”¨æˆ·ç™»å½•è¿‡ç¨‹ï¼š
è¾“å…¥è´¦å·å¯†ç  â†’ éªŒè¯æˆåŠŸ â†’ åˆ›å»ºSession â†’ å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ â†’ è·³è½¬åˆ°é¦–é¡µ

          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   ç”¨æˆ·ç™»å½•   â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
          â”‚   éªŒè¯è´¦å·   â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚æˆåŠŸ
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
          â”‚ åˆ›å»ºSession â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
          â”‚ å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
          â”‚   ç™»å½•æˆåŠŸ   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒä»£ç **ï¼š
```java
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) {
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        
        // éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        if ("admin".equals(username) && "123456".equals(password)) {
            // éªŒè¯æˆåŠŸï¼Œåˆ›å»ºSession
            HttpSession session = request.getSession(); // åˆ›å»ºæ–°Session
            session.setAttribute("loginUser", username);
            session.setAttribute("loginTime", new Date());
            
            // è·³è½¬åˆ°é¦–é¡µ
            response.sendRedirect("home.jsp");
        } else {
            // éªŒè¯å¤±è´¥
            request.setAttribute("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            request.getRequestDispatcher("login.jsp").forward(request, response);
        }
    }
}
```

### 5.2 ç™»å½•çŠ¶æ€æ£€æŸ¥


**æƒé™æ§åˆ¶æµç¨‹**ï¼š

```java
// ç™»å½•æ‹¦æˆªå™¨ï¼ˆè¿‡æ»¤å™¨ï¼‰
@WebFilter("/*") // æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
public class LoginFilter implements Filter {
    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) {
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) resp;
        
        String uri = request.getRequestURI();
        
        // ä¸éœ€è¦ç™»å½•çš„é¡µé¢
        if (uri.contains("login") || uri.contains("register")) {
            chain.doFilter(request, response); // æ”¾è¡Œ
            return;
        }
        
        // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
        HttpSession session = request.getSession(false); // ä¸åˆ›å»ºæ–°çš„
        if (session == null || session.getAttribute("loginUser") == null) {
            // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
            response.sendRedirect("login.jsp");
            return;
        }
        
        // å·²ç™»å½•ï¼Œç»§ç»­æ‰§è¡Œ
        chain.doFilter(request, response);
    }
}
```

### 5.3 è´­ç‰©è½¦åŠŸèƒ½å®ç°


**è´­ç‰©è½¦æ•°æ®ç®¡ç†**ï¼š

```java
@WebServlet("/cart")
public class CartServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) {
        // è·å–æˆ–åˆ›å»ºSession
        HttpSession session = request.getSession();
        
        // è·å–è´­ç‰©è½¦ï¼ˆå¦‚æœæ²¡æœ‰å°±åˆ›å»ºï¼‰
        Map<String, Integer> cart = (Map<String, Integer>) session.getAttribute("cart");
        if (cart == null) {
            cart = new HashMap<>();
            session.setAttribute("cart", cart);
        }
        
        // æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
        String productId = request.getParameter("productId");
        Integer quantity = cart.get(productId);
        if (quantity == null) {
            cart.put(productId, 1); // ç¬¬ä¸€æ¬¡æ·»åŠ 
        } else {
            cart.put(productId, quantity + 1); // æ•°é‡+1
        }
        
        response.getWriter().write("å•†å“å·²æ·»åŠ åˆ°è´­ç‰©è½¦ï¼Œå½“å‰æ•°é‡ï¼š" + cart.get(productId));
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Sessionæœ¬è´¨ï¼šæœåŠ¡å™¨ç«¯çš„ç”¨æˆ·çŠ¶æ€å­˜å‚¨æœºåˆ¶
ğŸ”¸ getSession()ï¼šè·å–æˆ–åˆ›å»ºSessionçš„æ ¸å¿ƒæ–¹æ³•
ğŸ”¸ SessionIDï¼šSessionçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç±»ä¼¼èº«ä»½è¯å·
ğŸ”¸ Cookieä¼ é€’ï¼šSessionIDåœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨é—´ä¼ é€’çš„ä¸»è¦æ–¹å¼
ğŸ”¸ ç”Ÿå‘½å‘¨æœŸï¼šä»åˆ›å»ºåˆ°é”€æ¯çš„å®Œæ•´è¿‡ç¨‹
```

### 6.2 å…³é”®æ–¹æ³•å¯¹æ¯”è®°å¿†


| ä½¿ç”¨åœºæ™¯ | **é€‰æ‹©æ–¹æ³•** | **è®°å¿†æŠ€å·§** | **å…¸å‹åº”ç”¨** |
|---------|-------------|-------------|-------------|
| **éœ€è¦Session** | `getSession()` | `"æ²¡æœ‰å°±åˆ›å»º"` | `ç”¨æˆ·ç™»å½•` |
| **åªæ˜¯æ£€æŸ¥** | `getSession(false)` | `"æ²¡æœ‰å°±ç®—äº†"` | `æƒé™éªŒè¯` |
| **é“¾æ¥å¤„ç†** | `encodeURL()` | `"æ™ºèƒ½é‡å†™"` | `é¡µé¢è·³è½¬` |

### 6.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–**
```
ç™»å½•é¡µé¢ï¼šä½¿ç”¨getSession()åˆ›å»ºSession
éªŒè¯é¡µé¢ï¼šä½¿ç”¨getSession(false)æ£€æŸ¥Session
é™æ€èµ„æºï¼šä¸è¦è°ƒç”¨getSession()
```

**ğŸ”¹ å®‰å…¨è€ƒè™‘**  
```
Sessionè¶…æ—¶ï¼šè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
æ•æ„Ÿæ“ä½œï¼šé‡æ–°éªŒè¯èº«ä»½
é€€å‡ºç™»å½•ï¼šæ‰‹åŠ¨é”€æ¯Session
```

**ğŸ”¹ å…¼å®¹æ€§å¤„ç†**
```
ä¼˜å…ˆCookieï¼šç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ
å¤‡ç”¨URLé‡å†™ï¼šå¤„ç†Cookieç¦ç”¨æƒ…å†µ
æ™ºèƒ½æ£€æµ‹ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³æ–¹å¼
```

### 6.4 å¸¸è§é—®é¢˜è§£ç­”


**â“ Sessionä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Ÿ**
- åªæœ‰è°ƒç”¨`getSession()`æˆ–`getSession(true)`æ—¶æ‰åˆ›å»º
- JSPé¡µé¢é»˜è®¤ä¼šè‡ªåŠ¨åˆ›å»ºï¼ˆé™¤éç¦ç”¨ï¼‰

**â“ SessionIDå¦‚ä½•ç”Ÿæˆï¼Ÿ**
- æœåŠ¡å™¨è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ID
- é€šå¸¸æ˜¯32ä½éšæœºå­—ç¬¦ä¸²
- ä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å¤„ç†

**â“ Sessionæ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ**
- å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­
- é‡å¯æœåŠ¡å™¨Sessionä¼šä¸¢å¤±
- å¯ä»¥é…ç½®æŒä¹…åŒ–å­˜å‚¨

**â“ å¦‚ä½•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Ÿ**
- ä½¿ç”¨`getSession(false)`è·å–Session
- æ£€æŸ¥Sessionæ˜¯å¦ä¸ºnull
- æ£€æŸ¥Sessionä¸­æ˜¯å¦æœ‰ç™»å½•æ ‡è¯†

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Sessionåƒè´¦æˆ·ï¼ŒgetSessionæ¥å¼€æˆ·
- falseå‚æ•°è¡¨ç¤ºä¸åˆ›å»ºï¼Œtrueå‚æ•°ä¼šæ–°å»º
- SessionIDé Cookieä¼ ï¼ŒURLé‡å†™æ˜¯å¤‡é€‰
- ç™»å½•åˆ›å»ºSessionï¼ŒéªŒè¯æ£€æŸ¥å°±å¤Ÿäº†