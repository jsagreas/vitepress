---
title: 3ã€Sessionæ•°æ®æ“ä½œ
---
## ğŸ“š ç›®å½•

1. [Sessionæ•°æ®æ“ä½œæ¦‚è¿°](#1-sessionæ•°æ®æ“ä½œæ¦‚è¿°)
2. [æ•°æ®å­˜å‚¨æ“ä½œ](#2-æ•°æ®å­˜å‚¨æ“ä½œ)
3. [æ•°æ®è·å–æ“ä½œ](#3-æ•°æ®è·å–æ“ä½œ)
4. [æ•°æ®åˆ é™¤æ“ä½œ](#4-æ•°æ®åˆ é™¤æ“ä½œ)
5. [æ•°æ®éå†æ“ä½œ](#5-æ•°æ®éå†æ“ä½œ)
6. [æ•°æ®ç±»å‹è½¬æ¢å¤„ç†](#6-æ•°æ®ç±»å‹è½¬æ¢å¤„ç†)
7. [å®é™…å¼€å‘åº”ç”¨](#7-å®é™…å¼€å‘åº”ç”¨)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“Š Sessionæ•°æ®æ“ä½œæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Sessionæ•°æ®æ“ä½œ


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
æƒ³è±¡ä¸€ä¸‹ä½ åœ¨é“¶è¡ŒåŠä¸šåŠ¡ï¼ŒæŸœå‘˜ä¼šä¸ºä½ å‡†å¤‡ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶è¢‹ï¼Œé‡Œé¢æ”¾ç€ä½ è¿™æ¬¡åŠä¸šåŠ¡éœ€è¦çš„å„ç§èµ„æ–™ã€‚Sessionæ•°æ®æ“ä½œå°±åƒæ˜¯ï¼š
- **å­˜æ”¾èµ„æ–™** - æŠŠé‡è¦ä¿¡æ¯æ”¾è¿›æ–‡ä»¶è¢‹
- **æŸ¥çœ‹èµ„æ–™** - ä»æ–‡ä»¶è¢‹é‡Œå–å‡ºéœ€è¦çš„ä¿¡æ¯
- **æ•´ç†èµ„æ–™** - åˆ é™¤ä¸éœ€è¦çš„ä¿¡æ¯
- **æ¸…ç‚¹èµ„æ–™** - çœ‹çœ‹æ–‡ä»¶è¢‹é‡Œéƒ½æœ‰ä»€ä¹ˆ

### 1.2 Sessionæ•°æ®çš„ç‰¹ç‚¹


**ğŸ”¸ æ ¸å¿ƒç‰¹æ€§**
```
æœåŠ¡å™¨ç«¯å­˜å‚¨ï¼šæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ï¼Œå®‰å…¨æ€§é«˜
é”®å€¼å¯¹å½¢å¼ï¼šä»¥key-valueçš„å½¢å¼å­˜å‚¨æ•°æ®
å¯¹è±¡ç±»å‹ï¼šå¯ä»¥å­˜å‚¨ä»»ä½•Javaå¯¹è±¡
ä¼šè¯èŒƒå›´ï¼šæ•°æ®åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯æœŸé—´æœ‰æ•ˆ
è·¨é¡µé¢å…±äº«ï¼šåŒä¸€ç”¨æˆ·çš„ä¸åŒé¡µé¢å¯ä»¥å…±äº«æ•°æ®
```

### 1.3 Sessionæ•°æ®æ“ä½œçš„ä½œç”¨


**ğŸ¯ å®é™…ç”¨é€”**
- **ç”¨æˆ·èº«ä»½ä¿¡æ¯** - å­˜å‚¨ç™»å½•ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯
- **è´­ç‰©è½¦æ•°æ®** - ä¸´æ—¶å­˜å‚¨ç”¨æˆ·é€‰æ‹©çš„å•†å“
- **è¡¨å•æ•°æ®** - å¤šæ­¥éª¤è¡¨å•çš„ä¸­é—´æ•°æ®
- **ä¸ªæ€§åŒ–è®¾ç½®** - ç”¨æˆ·çš„ä¸´æ—¶åå¥½é…ç½®
- **ä¸šåŠ¡æµç¨‹æ•°æ®** - å¤æ‚ä¸šåŠ¡æ“ä½œçš„ä¸­é—´çŠ¶æ€

---

## 2. ğŸ’¾ æ•°æ®å­˜å‚¨æ“ä½œ


### 2.1 setAttribute()æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```java
void setAttribute(String name, Object value)
```

**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
è¿™ä¸ªæ–¹æ³•å°±åƒå¾€ä½ çš„ç§äººä¿é™©ç®±é‡Œæ”¾ä¸œè¥¿ï¼Œä½ éœ€è¦ç»™æ¯æ ·ä¸œè¥¿èµ·ä¸ªåå­—ï¼ˆnameï¼‰ï¼Œç„¶åæŠŠä¸œè¥¿ï¼ˆvalueï¼‰æ”¾è¿›å»ã€‚

### 2.2 å­˜å‚¨æ“ä½œçš„å…·ä½“ä½¿ç”¨


**ğŸ“ åŸºæœ¬å­˜å‚¨ç¤ºä¾‹**
```java
// è·å–Sessionå¯¹è±¡
HttpSession session = request.getSession();

// å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®
session.setAttribute("username", "å¼ ä¸‰");           // å­˜å‚¨å­—ç¬¦ä¸²
session.setAttribute("age", 25);                   // å­˜å‚¨æ•´æ•°  
session.setAttribute("isLogin", true);             // å­˜å‚¨å¸ƒå°”å€¼
session.setAttribute("loginTime", new Date());     // å­˜å‚¨æ—¥æœŸå¯¹è±¡
```

### 2.3 å­˜å‚¨å¤æ‚å¯¹è±¡


**ğŸ”§ ç”¨æˆ·å¯¹è±¡å­˜å‚¨**
```java
// åˆ›å»ºç”¨æˆ·å¯¹è±¡
User user = new User();
user.setId(1001);
user.setUsername("å¼ ä¸‰");
user.setEmail("zhangsan@example.com");

// å­˜å‚¨ç”¨æˆ·å¯¹è±¡
session.setAttribute("currentUser", user);

// å­˜å‚¨è´­ç‰©è½¦åˆ—è¡¨
List<Product> cart = new ArrayList<>();
cart.add(new Product("æ‰‹æœº", 2999.0));
cart.add(new Product("è€³æœº", 199.0));
session.setAttribute("shoppingCart", cart);
```

### 2.4 å­˜å‚¨æ“ä½œçš„æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦æé†’**
```
åŒåè¦†ç›–ï¼šå¦‚æœç”¨ç›¸åŒçš„keyå†æ¬¡å­˜å‚¨ï¼Œä¼šè¦†ç›–ä¹‹å‰çš„å€¼
å†…å­˜è€ƒè™‘ï¼šSessionå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸è¦å­˜å‚¨è¿‡å¤§çš„å¯¹è±¡
åºåˆ—åŒ–ï¼šå¦‚æœå¯¹è±¡éœ€è¦åœ¨é›†ç¾¤é—´å…±äº«ï¼Œå¿…é¡»å®ç°Serializableæ¥å£
ç©ºå€¼å¤„ç†ï¼šå¯ä»¥å­˜å‚¨nullå€¼ï¼Œä½†è¦æ³¨æ„åç»­çš„ç©ºæŒ‡é’ˆå¼‚å¸¸
```

---

## 3. ğŸ” æ•°æ®è·å–æ“ä½œ


### 3.1 getAttribute()æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```java
Object getAttribute(String name)
```

**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
è¿™ä¸ªæ–¹æ³•å°±åƒä»ä½ çš„ç§äººä¿é™©ç®±é‡Œå–ä¸œè¥¿ï¼Œä½ å‘Šè¯‰å®ƒä½ è¦æ‰¾ä»€ä¹ˆåå­—çš„ä¸œè¥¿ï¼Œå®ƒå°±æŠŠé‚£ä¸ªä¸œè¥¿ç»™ä½ æ‹¿å‡ºæ¥ã€‚

### 3.2 è·å–æ“ä½œçš„åŸºæœ¬ä½¿ç”¨


**ğŸ“ åŸºæœ¬è·å–ç¤ºä¾‹**
```java
// è·å–Sessionå¯¹è±¡
HttpSession session = request.getSession();

// è·å–å­˜å‚¨çš„æ•°æ®
String username = (String) session.getAttribute("username");
Integer age = (Integer) session.getAttribute("age");
Boolean isLogin = (Boolean) session.getAttribute("isLogin");
Date loginTime = (Date) session.getAttribute("loginTime");
```

### 3.3 å®‰å…¨çš„æ•°æ®è·å–æ–¹å¼


**ğŸ›¡ï¸ é˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸**
```java
// æ–¹å¼1ï¼šå…ˆåˆ¤æ–­å†è½¬æ¢
Object usernameObj = session.getAttribute("username");
String username = null;
if (usernameObj != null) {
    username = (String) usernameObj;
}

// æ–¹å¼2ï¼šä½¿ç”¨å·¥å…·æ–¹æ³•
public class SessionUtils {
    public static String getString(HttpSession session, String name) {
        Object value = session.getAttribute(name);
        return value != null ? value.toString() : null;
    }
    
    public static Integer getInteger(HttpSession session, String name) {
        Object value = session.getAttribute(name);
        if (value instanceof Integer) {
            return (Integer) value;
        }
        return null;
    }
}
```

### 3.4 è·å–å¤æ‚å¯¹è±¡


**ğŸ”§ å¤æ‚å¯¹è±¡è·å–**
```java
// è·å–ç”¨æˆ·å¯¹è±¡
User currentUser = (User) session.getAttribute("currentUser");
if (currentUser != null) {
    System.out.println("å½“å‰ç”¨æˆ·ï¼š" + currentUser.getUsername());
    System.out.println("ç”¨æˆ·é‚®ç®±ï¼š" + currentUser.getEmail());
}

// è·å–è´­ç‰©è½¦åˆ—è¡¨
@SuppressWarnings("unchecked")
List<Product> cart = (List<Product>) session.getAttribute("shoppingCart");
if (cart != null && !cart.isEmpty()) {
    System.out.println("è´­ç‰©è½¦å•†å“æ•°é‡ï¼š" + cart.size());
}
```

---

## 4. ğŸ—‘ï¸ æ•°æ®åˆ é™¤æ“ä½œ


### 4.1 removeAttribute()æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```java
void removeAttribute(String name)
```

**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
è¿™ä¸ªæ–¹æ³•å°±åƒä»ä½ çš„ç§äººä¿é™©ç®±é‡ŒæŠŠæŸæ ·ä¸œè¥¿å½»åº•æ‰”æ‰ï¼Œå‘Šè¯‰å®ƒä½ è¦æ‰”æ‰ä»€ä¹ˆåå­—çš„ä¸œè¥¿ï¼Œå®ƒå°±å¸®ä½ æ¸…ç†æ‰ã€‚

### 4.2 åˆ é™¤æ“ä½œçš„å…·ä½“ä½¿ç”¨


**ğŸ“ å•ä¸ªæ•°æ®åˆ é™¤**
```java
HttpSession session = request.getSession();

// åˆ é™¤ç‰¹å®šçš„æ•°æ®
session.removeAttribute("username");      // åˆ é™¤ç”¨æˆ·å
session.removeAttribute("shoppingCart");  // æ¸…ç©ºè´­ç‰©è½¦
session.removeAttribute("tempData");      // åˆ é™¤ä¸´æ—¶æ•°æ®
```

### 4.3 æ‰¹é‡åˆ é™¤æ“ä½œ


**ğŸ”§ æ¸…ç†å¤šä¸ªç›¸å…³æ•°æ®**
```java
public void clearUserData(HttpSession session) {
    // æ¸…ç†ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰æ•°æ®
    session.removeAttribute("currentUser");
    session.removeAttribute("userPermissions");
    session.removeAttribute("userSettings");
    session.removeAttribute("lastLoginTime");
}

public void clearShoppingData(HttpSession session) {
    // æ¸…ç†è´­ç‰©ç›¸å…³çš„æ•°æ®
    session.removeAttribute("shoppingCart");
    session.removeAttribute("selectedAddress");
    session.removeAttribute("couponCode");
}
```

### 4.4 åˆ é™¤æ“ä½œçš„åº”ç”¨åœºæ™¯


**ğŸ¯ å¸¸è§ä½¿ç”¨åœºæ™¯**
```
ç”¨æˆ·ç™»å‡ºï¼šåˆ é™¤ç”¨æˆ·èº«ä»½ä¿¡æ¯
è®¢å•å®Œæˆï¼šæ¸…ç†è´­ç‰©è½¦å’Œä¸´æ—¶æ•°æ®
è¡¨å•æäº¤ï¼šåˆ é™¤è¡¨å•çš„ä¸­é—´æ•°æ®
æƒé™å˜æ›´ï¼šæ¸…ç†è¿‡æ—¶çš„æƒé™ä¿¡æ¯
é”™è¯¯é‡ç½®ï¼šåˆ é™¤é”™è¯¯çŠ¶æ€æ•°æ®
```

---

## 5. ğŸ“‹ æ•°æ®éå†æ“ä½œ


### 5.1 getAttributeNames()æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```java
Enumeration<String> getAttributeNames()
```

**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
è¿™ä¸ªæ–¹æ³•å°±åƒç»™ä½ ä¸€å¼ æ¸…å•ï¼Œå‘Šè¯‰ä½ ä¿é™©ç®±é‡Œéƒ½æ”¾äº†å“ªäº›ä¸œè¥¿çš„åå­—ï¼Œä½†ä¸ä¼šå‘Šè¯‰ä½ å…·ä½“çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚

### 5.2 éå†æ“ä½œçš„åŸºæœ¬ä½¿ç”¨


**ğŸ“ åŸºæœ¬éå†ç¤ºä¾‹**
```java
HttpSession session = request.getSession();

// è·å–æ‰€æœ‰å±æ€§å
Enumeration<String> attributeNames = session.getAttributeNames();

// éå†æ‰€æœ‰å±æ€§
while (attributeNames.hasMoreElements()) {
    String attributeName = attributeNames.nextElement();
    Object attributeValue = session.getAttribute(attributeName);
    
    System.out.println("å±æ€§åï¼š" + attributeName);
    System.out.println("å±æ€§å€¼ï¼š" + attributeValue);
    System.out.println("æ•°æ®ç±»å‹ï¼š" + attributeValue.getClass().getSimpleName());
    System.out.println("---");
}
```

### 5.3 å®ç”¨çš„éå†å·¥å…·æ–¹æ³•


**ğŸ”§ å°è£…éå†åŠŸèƒ½**
```java
public class SessionDebugUtils {
    
    // æ‰“å°æ‰€æœ‰Sessionæ•°æ®
    public static void printAllAttributes(HttpSession session) {
        System.out.println("=== Sessionæ•°æ®æ¸…å• ===");
        System.out.println("Session ID: " + session.getId());
        
        Enumeration<String> names = session.getAttributeNames();
        int count = 0;
        
        while (names.hasMoreElements()) {
            String name = names.nextElement();
            Object value = session.getAttribute(name);
            count++;
            
            System.out.printf("%d. %s = %s (%s)\n", 
                count, name, value, 
                value != null ? value.getClass().getSimpleName() : "null");
        }
        
        if (count == 0) {
            System.out.println("Sessionä¸­æ²¡æœ‰å­˜å‚¨ä»»ä½•æ•°æ®");
        }
        System.out.println("========================");
    }
    
    // æ£€æŸ¥Sessionæ˜¯å¦åŒ…å«ç‰¹å®šå‰ç¼€çš„å±æ€§
    public static boolean hasAttributeWithPrefix(HttpSession session, String prefix) {
        Enumeration<String> names = session.getAttributeNames();
        while (names.hasMoreElements()) {
            if (names.nextElement().startsWith(prefix)) {
                return true;
            }
        }
        return false;
    }
}
```

### 5.4 éå†çš„å®é™…åº”ç”¨


**ğŸ¯ å®ç”¨åœºæ™¯**
- **è°ƒè¯•è¯Šæ–­** - æŸ¥çœ‹Sessionä¸­å­˜å‚¨äº†å“ªäº›æ•°æ®
- **æ•°æ®æ¸…ç†** - æ‰¹é‡åˆ é™¤ç‰¹å®šç±»å‹çš„æ•°æ®
- **ç»Ÿè®¡åˆ†æ** - ç»Ÿè®¡Sessionä¸­çš„æ•°æ®ä½¿ç”¨æƒ…å†µ
- **æƒé™æ£€æŸ¥** - éªŒè¯å¿…éœ€çš„æƒé™æ•°æ®æ˜¯å¦å­˜åœ¨

---

## 6. ğŸ”„ æ•°æ®ç±»å‹è½¬æ¢å¤„ç†


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç±»å‹è½¬æ¢


**ğŸ’¡ æ ¸å¿ƒé—®é¢˜**ï¼š
Sessionçš„getAttribute()æ–¹æ³•è¿”å›çš„æ˜¯Objectç±»å‹ï¼Œå°±åƒä½ ä»ä¸€ä¸ªè£…æ»¡å„ç§ä¸œè¥¿çš„ç›’å­é‡Œå–ä¸œè¥¿ï¼Œå–å‡ºæ¥çš„éƒ½æ˜¯"ä¸œè¥¿"ï¼Œä½ éœ€è¦å‘Šè¯‰ç¨‹åºè¿™ä¸ª"ä¸œè¥¿"å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ã€‚

### 6.2 åŸºæœ¬ç±»å‹è½¬æ¢


**ğŸ“ å¸¸è§ç±»å‹è½¬æ¢**
```java
HttpSession session = request.getSession();

// å­—ç¬¦ä¸²è½¬æ¢
Object usernameObj = session.getAttribute("username");
String username = (String) usernameObj;

// æ•°å­—è½¬æ¢  
Object ageObj = session.getAttribute("age");
Integer age = (Integer) ageObj;

// å¸ƒå°”å€¼è½¬æ¢
Object loginObj = session.getAttribute("isLogin");
Boolean isLogin = (Boolean) loginObj;
```

### 6.3 å®‰å…¨çš„ç±»å‹è½¬æ¢æ–¹æ³•


**ğŸ›¡ï¸ é˜²æ­¢è½¬æ¢å¼‚å¸¸**
```java
public class SessionTypeUtils {
    
    // å®‰å…¨è·å–å­—ç¬¦ä¸²
    public static String safeGetString(HttpSession session, String name, String defaultValue) {
        try {
            Object value = session.getAttribute(name);
            if (value != null) {
                return value.toString();
            }
        } catch (Exception e) {
            System.err.println("è·å–å­—ç¬¦ä¸²å¤±è´¥: " + e.getMessage());
        }
        return defaultValue;
    }
    
    // å®‰å…¨è·å–æ•´æ•°
    public static Integer safeGetInteger(HttpSession session, String name, Integer defaultValue) {
        try {
            Object value = session.getAttribute(name);
            if (value instanceof Integer) {
                return (Integer) value;
            } else if (value instanceof String) {
                return Integer.parseInt((String) value);
            }
        } catch (Exception e) {
            System.err.println("è·å–æ•´æ•°å¤±è´¥: " + e.getMessage());
        }
        return defaultValue;
    }
    
    // å®‰å…¨è·å–å¸ƒå°”å€¼
    public static Boolean safeGetBoolean(HttpSession session, String name, Boolean defaultValue) {
        try {
            Object value = session.getAttribute(name);
            if (value instanceof Boolean) {
                return (Boolean) value;
            } else if (value instanceof String) {
                return Boolean.parseBoolean((String) value);
            }
        } catch (Exception e) {
            System.err.println("è·å–å¸ƒå°”å€¼å¤±è´¥: " + e.getMessage());
        }
        return defaultValue;
    }
}
```

### 6.4 å¤æ‚å¯¹è±¡çš„ç±»å‹è½¬æ¢


**ğŸ”§ è‡ªå®šä¹‰å¯¹è±¡è½¬æ¢**
```java
// å®‰å…¨è·å–ç”¨æˆ·å¯¹è±¡
public static User getCurrentUser(HttpSession session) {
    try {
        Object userObj = session.getAttribute("currentUser");
        if (userObj instanceof User) {
            return (User) userObj;
        }
    } catch (ClassCastException e) {
        System.err.println("ç”¨æˆ·å¯¹è±¡ç±»å‹è½¬æ¢å¤±è´¥: " + e.getMessage());
        // å¯ä»¥é€‰æ‹©æ¸…ç†é”™è¯¯æ•°æ®
        session.removeAttribute("currentUser");
    }
    return null;
}

// å®‰å…¨è·å–æ³›å‹é›†åˆ
@SuppressWarnings("unchecked")
public static <T> List<T> safeGetList(HttpSession session, String name, Class<T> elementType) {
    try {
        Object listObj = session.getAttribute(name);
        if (listObj instanceof List) {
            List<?> list = (List<?>) listObj;
            // ç®€å•éªŒè¯ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç±»å‹
            if (!list.isEmpty() && elementType.isInstance(list.get(0))) {
                return (List<T>) list;
            }
        }
    } catch (Exception e) {
        System.err.println("è·å–åˆ—è¡¨å¤±è´¥: " + e.getMessage());
    }
    return new ArrayList<>();
}
```

### 6.5 ç±»å‹è½¬æ¢çš„æœ€ä½³å®è·µ


**ğŸ¯ æ¨èåšæ³•**
```
1. æ€»æ˜¯æ£€æŸ¥nullå€¼
2. ä½¿ç”¨instanceofåˆ¤æ–­ç±»å‹
3. æä¾›é»˜è®¤å€¼å¤„ç†å¼‚å¸¸æƒ…å†µ
4. è®°å½•è½¬æ¢å¤±è´¥çš„æ—¥å¿—
5. è€ƒè™‘ä½¿ç”¨å·¥å…·ç±»ç»Ÿä¸€å¤„ç†
```

---

## 7. ğŸš€ å®é™…å¼€å‘åº”ç”¨


### 7.1 ç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†


**ğŸ” å®Œæ•´ç™»å½•ç¤ºä¾‹**
```java
// ç™»å½•å¤„ç†
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        
        // éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆå®é™…å¼€å‘ä¸­åº”è¯¥æŸ¥è¯¢æ•°æ®åº“ï¼‰
        if (validateUser(username, password)) {
            HttpSession session = request.getSession();
            
            // å­˜å‚¨ç™»å½•ä¿¡æ¯
            session.setAttribute("isLogin", true);
            session.setAttribute("username", username);
            session.setAttribute("loginTime", new Date());
            session.setAttribute("userRole", getUserRole(username));
            
            response.sendRedirect("dashboard.jsp");
        } else {
            request.setAttribute("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            request.getRequestDispatcher("login.jsp").forward(request, response);
        }
    }
}

// ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨
@WebFilter("/*")
public class LoginFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•
        String uri = req.getRequestURI();
        if (needLogin(uri)) {
            HttpSession session = req.getSession(false);
            Boolean isLogin = session != null ? 
                (Boolean) session.getAttribute("isLogin") : false;
            
            if (isLogin == null || !isLogin) {
                resp.sendRedirect("login.jsp");
                return;
            }
        }
        
        chain.doFilter(request, response);
    }
}
```

### 7.2 è´­ç‰©è½¦åŠŸèƒ½å®ç°


**ğŸ›’ è´­ç‰©è½¦ç®¡ç†**
```java
@WebServlet("/cart")
public class CartServlet extends HttpServlet {
    
    // æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        String action = request.getParameter("action");
        HttpSession session = request.getSession();
        
        // è·å–è´­ç‰©è½¦ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°çš„
        @SuppressWarnings("unchecked")
        List<CartItem> cart = (List<CartItem>) session.getAttribute("shoppingCart");
        if (cart == null) {
            cart = new ArrayList<>();
            session.setAttribute("shoppingCart", cart);
        }
        
        if ("add".equals(action)) {
            // æ·»åŠ å•†å“
            String productId = request.getParameter("productId");
            int quantity = Integer.parseInt(request.getParameter("quantity"));
            
            CartItem item = new CartItem(productId, quantity);
            cart.add(item);
            
            // æ›´æ–°è´­ç‰©è½¦ç»Ÿè®¡ä¿¡æ¯
            updateCartSummary(session, cart);
            
        } else if ("remove".equals(action)) {
            // ç§»é™¤å•†å“
            String productId = request.getParameter("productId");
            cart.removeIf(item -> item.getProductId().equals(productId));
            updateCartSummary(session, cart);
            
        } else if ("clear".equals(action)) {
            // æ¸…ç©ºè´­ç‰©è½¦
            session.removeAttribute("shoppingCart");
            session.removeAttribute("cartTotal");
            session.removeAttribute("cartCount");
        }
        
        response.sendRedirect("cart.jsp");
    }
    
    private void updateCartSummary(HttpSession session, List<CartItem> cart) {
        int totalCount = cart.stream().mapToInt(CartItem::getQuantity).sum();
        double totalPrice = cart.stream()
            .mapToDouble(item -> item.getPrice() * item.getQuantity())
            .sum();
            
        session.setAttribute("cartCount", totalCount);
        session.setAttribute("cartTotal", totalPrice);
    }
}
```

### 7.3 å¤šæ­¥éª¤è¡¨å•å¤„ç†


**ğŸ“ åˆ†æ­¥è¡¨å•ç¤ºä¾‹**
```java
// ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬ä¿¡æ¯
@WebServlet("/register-step1")
public class RegisterStep1Servlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // è·å–è¡¨å•æ•°æ®
        String username = request.getParameter("username");
        String email = request.getParameter("email");
        
        // éªŒè¯æ•°æ®
        if (isValid(username, email)) {
            HttpSession session = request.getSession();
            
            // å­˜å‚¨ç¬¬ä¸€æ­¥çš„æ•°æ®
            session.setAttribute("reg_username", username);
            session.setAttribute("reg_email", email);
            session.setAttribute("reg_step", 1);
            
            response.sendRedirect("register-step2.jsp");
        } else {
            request.setAttribute("error", "ä¿¡æ¯å¡«å†™æœ‰è¯¯");
            request.getRequestDispatcher("register-step1.jsp").forward(request, response);
        }
    }
}

// ç¬¬äºŒæ­¥ï¼šè¯¦ç»†ä¿¡æ¯
@WebServlet("/register-step2")  
public class RegisterStep2Servlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        HttpSession session = request.getSession();
        
        // æ£€æŸ¥æ˜¯å¦å®Œæˆäº†ç¬¬ä¸€æ­¥
        Integer currentStep = (Integer) session.getAttribute("reg_step");
        if (currentStep == null || currentStep < 1) {
            response.sendRedirect("register-step1.jsp");
            return;
        }
        
        // è·å–ç¬¬äºŒæ­¥çš„æ•°æ®
        String phone = request.getParameter("phone");
        String address = request.getParameter("address");
        
        // å­˜å‚¨ç¬¬äºŒæ­¥æ•°æ®
        session.setAttribute("reg_phone", phone);
        session.setAttribute("reg_address", address);
        session.setAttribute("reg_step", 2);
        
        response.sendRedirect("register-confirm.jsp");
    }
}

// ç¡®è®¤æäº¤
@WebServlet("/register-confirm")
public class RegisterConfirmServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        HttpSession session = request.getSession();
        
        // æ£€æŸ¥æ˜¯å¦å®Œæˆäº†å‰é¢çš„æ­¥éª¤
        Integer currentStep = (Integer) session.getAttribute("reg_step");
        if (currentStep == null || currentStep < 2) {
            response.sendRedirect("register-step1.jsp");
            return;
        }
        
        // æ”¶é›†æ‰€æœ‰æ³¨å†Œä¿¡æ¯
        String username = (String) session.getAttribute("reg_username");
        String email = (String) session.getAttribute("reg_email");  
        String phone = (String) session.getAttribute("reg_phone");
        String address = (String) session.getAttribute("reg_address");
        
        // ä¿å­˜åˆ°æ•°æ®åº“
        if (saveUser(username, email, phone, address)) {
            // æ¸…ç†æ³¨å†Œè¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®
            clearRegistrationData(session);
            
            request.setAttribute("message", "æ³¨å†ŒæˆåŠŸï¼");
            request.getRequestDispatcher("login.jsp").forward(request, response);
        } else {
            request.setAttribute("error", "æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•");
            request.getRequestDispatcher("register-confirm.jsp").forward(request, response);
        }
    }
    
    private void clearRegistrationData(HttpSession session) {
        session.removeAttribute("reg_username");
        session.removeAttribute("reg_email");
        session.removeAttribute("reg_phone");
        session.removeAttribute("reg_address");
        session.removeAttribute("reg_step");
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ setAttribute() - å¾€Sessioné‡Œå­˜æ•°æ®ï¼Œåƒå¾€ä¿é™©ç®±æ”¾ä¸œè¥¿
ğŸ”¸ getAttribute() - ä»Sessioné‡Œå–æ•°æ®ï¼Œéœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢
ğŸ”¸ removeAttribute() - åˆ é™¤Sessionä¸­çš„ç‰¹å®šæ•°æ®
ğŸ”¸ getAttributeNames() - è·å–Sessionä¸­æ‰€æœ‰æ•°æ®çš„åç§°åˆ—è¡¨
ğŸ”¸ ç±»å‹è½¬æ¢ - getAttribute()è¿”å›Objectï¼Œéœ€è¦è½¬æ¢ä¸ºå…·ä½“ç±»å‹
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ•°æ®å­˜å‚¨çš„æœ¬è´¨**
```
Sessionæ•°æ®å­˜å‚¨ï¼š
- ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­
- å¯ä»¥å­˜å‚¨ä»»ä½•Javaå¯¹è±¡
- åŒåé”®ä¼šè¦†ç›–ä¹‹å‰çš„å€¼
- æ•°æ®åœ¨æ•´ä¸ªä¼šè¯æœŸé—´æœ‰æ•ˆ
```

**ğŸ”¹ ç±»å‹è½¬æ¢çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦ç±»å‹è½¬æ¢ï¼š
- getAttribute()è¿”å›Objectç±»å‹
- éœ€è¦è½¬æ¢ä¸ºå…·ä½“ç±»å‹æ‰èƒ½ä½¿ç”¨
- è½¬æ¢æ—¶è¦é˜²æ­¢ç©ºæŒ‡é’ˆå’Œç±»å‹è½¬æ¢å¼‚å¸¸
- å»ºè®®ä½¿ç”¨å·¥å…·æ–¹æ³•è¿›è¡Œå®‰å…¨è½¬æ¢
```

**ğŸ”¹ æ•°æ®æ“ä½œçš„æœ€ä½³å®è·µ**
```
å¼€å‘å»ºè®®ï¼š
- æ€»æ˜¯æ£€æŸ¥nullå€¼
- ä½¿ç”¨æœ‰æ„ä¹‰çš„é”®å
- åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„æ•°æ®
- ä¸è¦å­˜å‚¨è¿‡å¤§çš„å¯¹è±¡
- è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜
```

### 8.3 å®é™…åº”ç”¨åœºæ™¯å¯¹ç…§è¡¨


| æ“ä½œæ–¹æ³• | **åº”ç”¨åœºæ™¯** | **ç¤ºä¾‹ç”¨é€”** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|-------------|
| `setAttribute()` | **å­˜å‚¨ç”¨æˆ·çŠ¶æ€** | `ç™»å½•ä¿¡æ¯ã€è´­ç‰©è½¦ã€è¡¨å•æ•°æ®` | `é¿å…å­˜å‚¨æ•æ„Ÿä¿¡æ¯` |
| `getAttribute()` | **è·å–ç”¨æˆ·çŠ¶æ€** | `æ£€æŸ¥ç™»å½•çŠ¶æ€ã€è·å–ç”¨æˆ·ä¿¡æ¯` | `æ³¨æ„ç±»å‹è½¬æ¢å’Œnullå€¼` |
| `removeAttribute()` | **æ¸…ç†ä¸´æ—¶æ•°æ®** | `ç™»å‡ºæ¸…ç†ã€å®Œæˆè®¢å•åæ¸…ç†` | `ç¡®ä¿ä¸å½±å“å…¶ä»–åŠŸèƒ½` |
| `getAttributeNames()` | **è°ƒè¯•å’Œç»Ÿè®¡** | `æŸ¥çœ‹Sessionå†…å®¹ã€æ‰¹é‡æ¸…ç†` | `ä¸»è¦ç”¨äºè°ƒè¯•ï¼Œç”Ÿäº§ç¯å¢ƒå°‘ç”¨` |

### 8.4 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**â“ å¸¸è§é—®é¢˜å¤„ç†**
```
é—®é¢˜1ï¼šClassCastExceptionç±»å‹è½¬æ¢å¼‚å¸¸
è§£å†³ï¼šä½¿ç”¨instanceofåˆ¤æ–­ç±»å‹ï¼Œæä¾›é»˜è®¤å€¼

é—®é¢˜2ï¼šNullPointerExceptionç©ºæŒ‡é’ˆå¼‚å¸¸  
è§£å†³ï¼šè·å–æ•°æ®åå…ˆæ£€æŸ¥æ˜¯å¦ä¸ºnull

é—®é¢˜3ï¼šå†…å­˜å ç”¨è¿‡å¤§
è§£å†³ï¼šåŠæ—¶æ¸…ç†ä¸éœ€è¦çš„æ•°æ®ï¼Œé¿å…å­˜å‚¨å¤§å¯¹è±¡

é—®é¢˜4ï¼šæ•°æ®è¢«æ„å¤–è¦†ç›–
è§£å†³ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„é”®åï¼Œé¿å…é‡å¤ä½¿ç”¨ç›¸åŒé”®å
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- **å­˜æ•°æ®ç”¨setAttributeï¼Œé”®å€¼å¯¹å¾€é‡Œå¡**
- **å–æ•°æ®ç”¨getAttributeï¼Œç±»å‹è½¬æ¢åˆ«å¿˜è®°**  
- **åˆ æ•°æ®ç”¨removeAttributeï¼ŒåŠæ—¶æ¸…ç†å†…å­˜çœ**
- **éå†æ•°æ®ç”¨getAttributeNamesï¼Œè°ƒè¯•ç»Ÿè®¡éƒ½èƒ½è¡Œ**