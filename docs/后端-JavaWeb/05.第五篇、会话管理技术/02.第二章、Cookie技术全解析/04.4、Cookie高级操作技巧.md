---
title: 4ã€Cookieé«˜çº§æ“ä½œæŠ€å·§
---
## ğŸ“š ç›®å½•

1. [Cookieæ›´æ–°ç­–ç•¥æ·±å…¥è§£æ](#1-Cookieæ›´æ–°ç­–ç•¥æ·±å…¥è§£æ)
2. [Cookieåˆ é™¤æ–¹æ³•è¯¦è§£](#2-Cookieåˆ é™¤æ–¹æ³•è¯¦è§£)
3. [å¤šå€¼å­˜å‚¨æŠ€æœ¯å®ç°](#3-å¤šå€¼å­˜å‚¨æŠ€æœ¯å®ç°)
4. [æµè§ˆå™¨ç¦ç”¨Cookieå¤„ç†æ–¹æ¡ˆ](#4-æµè§ˆå™¨ç¦ç”¨Cookieå¤„ç†æ–¹æ¡ˆ)
5. [Cookieé™åˆ¶é—®é¢˜åº”å¯¹ç­–ç•¥](#5-Cookieé™åˆ¶é—®é¢˜åº”å¯¹ç­–ç•¥)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ Cookieæ›´æ–°ç­–ç•¥æ·±å…¥è§£æ


### 1.1 Cookieæ›´æ–°çš„æœ¬è´¨åŸç†


**ğŸ¤” ä»€ä¹ˆæ˜¯Cookieæ›´æ–°ï¼Ÿ**

ç®€å•æ¥è¯´ï¼ŒCookieæ›´æ–°å°±æ˜¯**è¦†ç›–åŸæœ‰çš„Cookieå€¼**ã€‚ç”±äºHTTPåè®®çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥"ä¿®æ”¹"ä¸€ä¸ªå·²å­˜åœ¨çš„Cookieï¼Œè€Œæ˜¯**åˆ›å»ºä¸€ä¸ªåŒåçš„æ–°Cookieæ¥æ›¿æ¢æ—§çš„**ã€‚

```
æµè§ˆå™¨Cookieå­˜å‚¨é€»è¾‘ï¼š
æ—§Cookie: name=å¼ ä¸‰, path=/, domain=example.com
æ–°Cookie: name=æå››, path=/, domain=example.com
ç»“æœ: æµè§ˆå™¨è‡ªåŠ¨ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼
```

**ğŸ’¡ æ›´æ–°æœºåˆ¶çš„å…³é”®ç†è§£**

Cookieçš„æ›´æ–°éµå¾ª"**åŒåè¦†ç›–**"åŸåˆ™ï¼š
- **Cookieåç§°**ç›¸åŒ
- **åŸŸå(domain)**ç›¸åŒ  
- **è·¯å¾„(path)**ç›¸åŒ

æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶æ—¶ï¼Œæ–°Cookieä¼šè‡ªåŠ¨è¦†ç›–æ—§Cookieã€‚

### 1.2 æ ‡å‡†æ›´æ–°æ“ä½œå®ç°


**ğŸ”¸ åŸºç¡€æ›´æ–°æ–¹å¼**

```java
// åŸæœ‰Cookie: username=oldUser
Cookie cookie = new Cookie("username", "newUser");
response.addCookie(cookie);
// ç»“æœ: username=newUser (è‡ªåŠ¨è¦†ç›–)
```

**ğŸ”¸ å®Œæ•´æ›´æ–°ç¤ºä¾‹**

```java
@WebServlet("/updateUserInfo")
public class UpdateUserServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) {
        
        // ğŸ”¹ è·å–æ–°çš„ç”¨æˆ·ä¿¡æ¯
        String newUsername = request.getParameter("username");
        String newEmail = request.getParameter("email");
        
        // ğŸ”¹ æ›´æ–°ç”¨æˆ·åCookie
        Cookie userCookie = new Cookie("username", newUsername);
        userCookie.setMaxAge(7 * 24 * 60 * 60); // ä¿æŒ7å¤©
        userCookie.setPath("/"); // æ•´ä¸ªç½‘ç«™å¯ç”¨
        response.addCookie(userCookie);
        
        // ğŸ”¹ æ›´æ–°é‚®ç®±Cookie
        Cookie emailCookie = new Cookie("email", newEmail);
        emailCookie.setMaxAge(7 * 24 * 60 * 60);
        emailCookie.setPath("/");
        response.addCookie(emailCookie);
        
        // ğŸ”¹ è¿”å›æˆåŠŸä¿¡æ¯
        response.getWriter().write("ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸï¼");
    }
}
```

### 1.3 é«˜çº§æ›´æ–°ç­–ç•¥


**ğŸ”¸ æ¡ä»¶æ€§æ›´æ–°**

æœ‰æ—¶æˆ‘ä»¬éœ€è¦åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰æ›´æ–°Cookieï¼š

```java
// ğŸ”¹ æ£€æŸ¥å½“å‰Cookieå€¼ï¼Œå†³å®šæ˜¯å¦æ›´æ–°
Cookie[] cookies = request.getCookies();
String currentTheme = null;

// æŸ¥æ‰¾å½“å‰ä¸»é¢˜è®¾ç½®
if (cookies != null) {
    for (Cookie cookie : cookies) {
        if ("theme".equals(cookie.getName())) {
            currentTheme = cookie.getValue();
            break;
        }
    }
}

// ğŸ”¹ åªæœ‰å½“ä¸»é¢˜ä¸åŒæ—¶æ‰æ›´æ–°
String newTheme = request.getParameter("theme");
if (!newTheme.equals(currentTheme)) {
    Cookie themeCookie = new Cookie("theme", newTheme);
    themeCookie.setMaxAge(30 * 24 * 60 * 60); // 30å¤©
    response.addCookie(themeCookie);
}
```

**ğŸ”¸ æ‰¹é‡æ›´æ–°ç­–ç•¥**

```java
// ğŸ”¹ ç”¨æˆ·è®¾ç½®æ‰¹é‡æ›´æ–°
Map<String, String> userSettings = new HashMap<>();
userSettings.put("language", "zh-CN");
userSettings.put("timezone", "Asia/Shanghai");
userSettings.put("pageSize", "20");

// ğŸ”¹ æ‰¹é‡åˆ›å»ºå’Œæ›´æ–°Cookie
for (Map.Entry<String, String> setting : userSettings.entrySet()) {
    Cookie cookie = new Cookie(setting.getKey(), setting.getValue());
    cookie.setMaxAge(365 * 24 * 60 * 60); // 1å¹´æœ‰æ•ˆæœŸ
    cookie.setPath("/");
    response.addCookie(cookie);
}
```

---

## 2. ğŸ—‘ï¸ Cookieåˆ é™¤æ–¹æ³•è¯¦è§£


### 2.1 Cookieåˆ é™¤çš„æ ¸å¿ƒåŸç†


**ğŸ¤” ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥åˆ é™¤Cookieï¼Ÿ**

è¿™æ˜¯æ–°æ‰‹å¸¸å›°æƒ‘çš„åœ°æ–¹ï¼š**HTTPåè®®æ²¡æœ‰"åˆ é™¤Cookie"çš„ç›´æ¥æŒ‡ä»¤**ã€‚æˆ‘ä»¬åªèƒ½é€šè¿‡ä¸€ä¸ª"å·§å¦™çš„æ–¹æ³•"æ¥å®ç°åˆ é™¤æ•ˆæœã€‚

**ğŸ’¡ åˆ é™¤çš„å®ç°åŸç†**

åˆ é™¤Cookieå®é™…ä¸Šæ˜¯**è®©Cookieç«‹å³è¿‡æœŸ**ï¼š
1. åˆ›å»ºä¸€ä¸ª**åŒåçš„Cookie**
2. å°†å®ƒçš„**æœ‰æ•ˆæœŸè®¾ä¸º0æˆ–è´Ÿæ•°**
3. æµè§ˆå™¨æ”¶åˆ°åä¼š**ç«‹å³ç§»é™¤**è¿™ä¸ªCookie

```
åˆ é™¤é€»è¾‘ç¤ºæ„ï¼š
æ­¥éª¤1: åˆ›å»ºåŒåCookie â†’ name=username, value=""
æ­¥éª¤2: è®¾ç½®ç«‹å³è¿‡æœŸ â†’ setMaxAge(0)
æ­¥éª¤3: å‘é€ç»™æµè§ˆå™¨ â†’ response.addCookie()
ç»“æœ: æµè§ˆå™¨åˆ é™¤åŸCookie
```

### 2.2 æ ‡å‡†åˆ é™¤æ“ä½œ


**ğŸ”¸ åŸºæœ¬åˆ é™¤æ–¹æ³•**

```java
// ğŸ”¹ åˆ é™¤ç”¨æˆ·åCookie
Cookie deleteCookie = new Cookie("username", "");
deleteCookie.setMaxAge(0); // ç«‹å³è¿‡æœŸ
deleteCookie.setPath("/"); // å¿…é¡»ä¸åŸCookieè·¯å¾„ä¸€è‡´
response.addCookie(deleteCookie);
```

> âš ï¸ **é‡è¦æé†’**  
> åˆ é™¤Cookieæ—¶ï¼Œ`path`å’Œ`domain`å¿…é¡»ä¸åŸCookieå®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™åˆ é™¤ä¼šå¤±è´¥ï¼

**ğŸ”¸ å®Œæ•´åˆ é™¤ç¤ºä¾‹**

```java
@WebServlet("/logout")
public class LogoutServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) {
        
        // ğŸ”¹ éœ€è¦åˆ é™¤çš„Cookieåˆ—è¡¨
        String[] cookiesToDelete = {"username", "userRole", "loginTime"};
        
        for (String cookieName : cookiesToDelete) {
            Cookie deleteCookie = new Cookie(cookieName, "");
            deleteCookie.setMaxAge(0); // ç«‹å³è¿‡æœŸ
            deleteCookie.setPath("/"); // ç¡®ä¿è·¯å¾„æ­£ç¡®
            response.addCookie(deleteCookie);
        }
        
        // ğŸ”¹ é‡å®šå‘åˆ°ç™»å½•é¡µé¢
        response.sendRedirect("login.jsp");
    }
}
```

### 2.3 åˆ é™¤æ“ä½œçš„æ³¨æ„äº‹é¡¹


**ğŸ”¸ è·¯å¾„åŒ¹é…é—®é¢˜**

è¿™æ˜¯åˆ é™¤Cookieæœ€å¸¸è§çš„é—®é¢˜ï¼š

```java
// âŒ é”™è¯¯ç¤ºä¾‹ - è·¯å¾„ä¸åŒ¹é…
// åŸCookieåˆ›å»ºæ—¶: setPath("/admin")
Cookie wrongDelete = new Cookie("adminToken", "");
wrongDelete.setMaxAge(0);
wrongDelete.setPath("/"); // è·¯å¾„ä¸åŒ¹é…ï¼Œåˆ é™¤å¤±è´¥ï¼

// âœ… æ­£ç¡®ç¤ºä¾‹ - è·¯å¾„å®Œå…¨åŒ¹é…
Cookie correctDelete = new Cookie("adminToken", "");
correctDelete.setMaxAge(0);
correctDelete.setPath("/admin"); // è·¯å¾„åŒ¹é…ï¼Œåˆ é™¤æˆåŠŸ
```

**ğŸ”¸ åŸŸååŒ¹é…é—®é¢˜**

```java
// å¦‚æœåŸCookieè®¾ç½®äº†domainï¼Œåˆ é™¤æ—¶ä¹Ÿå¿…é¡»è®¾ç½®ç›¸åŒdomain
Cookie deleteCookie = new Cookie("crossDomainData", "");
deleteCookie.setMaxAge(0);
deleteCookie.setPath("/");
deleteCookie.setDomain(".example.com"); // å¿…é¡»ä¸åŸCookieä¸€è‡´
response.addCookie(deleteCookie);
```

---

## 3. ğŸ“¦ å¤šå€¼å­˜å‚¨æŠ€æœ¯å®ç°


### 3.1 å¤šå€¼å­˜å‚¨çš„éœ€æ±‚åœºæ™¯


**ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦å¤šå€¼å­˜å‚¨ï¼Ÿ**

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨Cookieä¸­å­˜å‚¨**å¤šä¸ªç›¸å…³çš„æ•°æ®**ï¼š
- è´­ç‰©è½¦ä¸­çš„**å¤šä¸ªå•†å“**
- ç”¨æˆ·çš„**å¤šä¸ªåå¥½è®¾ç½®**
- æµè§ˆå†å²çš„**å¤šä¸ªé¡µé¢**

**ğŸ’¡ å•ä¸ªCookieå­˜å‚¨å¤šä¸ªå€¼çš„ä¼˜åŠ¿**

ç›¸æ¯”åˆ›å»ºå¤šä¸ªCookieï¼Œå¤šå€¼å­˜å‚¨æœ‰æ˜æ˜¾ä¼˜åŠ¿ï¼š

| æ–¹æ¡ˆå¯¹æ¯” | **å¤šä¸ªCookie** | **å•ä¸ªå¤šå€¼Cookie** |
|---------|---------------|------------------|
| ğŸ”¸ **ç½‘ç»œå¼€é”€** | `æ¯ä¸ªè¯·æ±‚éƒ½å‘é€å¤šä¸ªCookie` | `åªå‘é€ä¸€ä¸ªCookie` |
| ğŸ”¸ **ç®¡ç†å¤æ‚åº¦** | `éœ€è¦ç®¡ç†å¤šä¸ªCookieç”Ÿå‘½å‘¨æœŸ` | `ç»Ÿä¸€ç®¡ç†ï¼Œç®€å•æ¸…æ™°` |
| ğŸ”¸ **å­˜å‚¨é™åˆ¶** | `å®¹æ˜“è¾¾åˆ°å•åŸŸåCookieæ•°é‡é™åˆ¶` | `å……åˆ†åˆ©ç”¨å•ä¸ªCookieçš„4KBç©ºé—´` |

### 3.2 JSONæ ¼å¼å¤šå€¼å­˜å‚¨


**ğŸ”¸ åŸºæœ¬å®ç°æ€è·¯**

å°†å¤šä¸ªå€¼ç»„ç»‡æˆJSONå­—ç¬¦ä¸²ï¼Œå­˜å‚¨åœ¨å•ä¸ªCookieä¸­ï¼š

```java
// ğŸ”¹ åˆ›å»ºç”¨æˆ·åå¥½è®¾ç½®çš„å¤šå€¼Cookie
Map<String, String> userPrefs = new HashMap<>();
userPrefs.put("theme", "dark");
userPrefs.put("language", "zh-CN");
userPrefs.put("pageSize", "20");

// ğŸ”¹ è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
String jsonString = "{\"theme\":\"dark\",\"language\":\"zh-CN\",\"pageSize\":\"20\"}";

// ğŸ”¹ å­˜å‚¨åˆ°Cookie
Cookie prefsCookie = new Cookie("userPrefs", jsonString);
prefsCookie.setMaxAge(30 * 24 * 60 * 60); // 30å¤©
response.addCookie(prefsCookie);
```

**ğŸ”¸ JSONå­˜å‚¨çš„å®Œæ•´ç¤ºä¾‹**

```java
@WebServlet("/savePreferences")
public class SavePreferencesServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) {
        
        // ğŸ”¹ æ”¶é›†ç”¨æˆ·è®¾ç½®
        String theme = request.getParameter("theme");
        String language = request.getParameter("language");
        String pageSize = request.getParameter("pageSize");
        
        // ğŸ”¹ æ„å»ºJSONå­—ç¬¦ä¸²ï¼ˆæ‰‹åŠ¨æ„å»ºï¼Œé¿å…ä¾èµ–å¤–éƒ¨åº“ï¼‰
        StringBuilder json = new StringBuilder();
        json.append("{");
        json.append("\"theme\":\"").append(theme).append("\",");
        json.append("\"language\":\"").append(language).append("\",");
        json.append("\"pageSize\":\"").append(pageSize).append("\"");
        json.append("}");
        
        // ğŸ”¹ åˆ›å»ºå¤šå€¼Cookie
        Cookie prefsCookie = new Cookie("userPrefs", json.toString());
        prefsCookie.setMaxAge(30 * 24 * 60 * 60);
        prefsCookie.setPath("/");
        response.addCookie(prefsCookie);
        
        response.getWriter().write("åå¥½è®¾ç½®å·²ä¿å­˜");
    }
}
```

### 3.3 åˆ†éš”ç¬¦æ ¼å¼å¤šå€¼å­˜å‚¨


**ğŸ”¸ ç®€å•åˆ†éš”ç¬¦æ–¹å¼**

å¯¹äºç®€å•çš„å¤šå€¼æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨åˆ†éš”ç¬¦ï¼š

```java
// ğŸ”¹ è´­ç‰©è½¦å•†å“IDåˆ—è¡¨
List<String> cartItems = Arrays.asList("001", "002", "003");
String cartValue = String.join(",", cartItems); // "001,002,003"

Cookie cartCookie = new Cookie("cartItems", cartValue);
cartCookie.setMaxAge(24 * 60 * 60); // 1å¤©
response.addCookie(cartCookie);
```

**ğŸ”¸ è¯»å–åˆ†éš”ç¬¦æ ¼å¼æ•°æ®**

```java
// ğŸ”¹ ä»Cookieä¸­è¯»å–è´­ç‰©è½¦æ•°æ®
Cookie[] cookies = request.getCookies();
String cartValue = null;

if (cookies != null) {
    for (Cookie cookie : cookies) {
        if ("cartItems".equals(cookie.getName())) {
            cartValue = cookie.getValue();
            break;
        }
    }
}

// ğŸ”¹ è§£æå•†å“IDåˆ—è¡¨
if (cartValue != null && !cartValue.isEmpty()) {
    String[] itemIds = cartValue.split(",");
    for (String itemId : itemIds) {
        System.out.println("è´­ç‰©è½¦å•†å“: " + itemId);
    }
}
```

### 3.4 é”®å€¼å¯¹æ ¼å¼å­˜å‚¨


**ğŸ”¸ è‡ªå®šä¹‰é”®å€¼å¯¹æ ¼å¼**

```java
// ğŸ”¹ ç”¨æˆ·æµè§ˆå†å² (é¡µé¢ID=è®¿é—®æ—¶é—´)
Map<String, String> browseHistory = new HashMap<>();
browseHistory.put("page1", "2024-01-15");
browseHistory.put("page2", "2024-01-16");

// ğŸ”¹ è½¬æ¢ä¸ºé”®å€¼å¯¹å­—ç¬¦ä¸²æ ¼å¼
StringBuilder history = new StringBuilder();
for (Map.Entry<String, String> entry : browseHistory.entrySet()) {
    if (history.length() > 0) history.append("|");
    history.append(entry.getKey()).append("=").append(entry.getValue());
}
// ç»“æœ: "page1=2024-01-15|page2=2024-01-16"

Cookie historyCookie = new Cookie("browseHistory", history.toString());
response.addCookie(historyCookie);
```

---

## 4. ğŸš« æµè§ˆå™¨ç¦ç”¨Cookieå¤„ç†æ–¹æ¡ˆ


### 4.1 æµè§ˆå™¨ç¦ç”¨Cookieçš„ç°å®æƒ…å†µ


**ğŸ¤” ä¸ºä»€ä¹ˆä¼šæœ‰ç”¨æˆ·ç¦ç”¨Cookieï¼Ÿ**

ç°å®ä¸­ç¡®å®æœ‰éƒ¨åˆ†ç”¨æˆ·ä¼šç¦ç”¨Cookieï¼ŒåŸå› åŒ…æ‹¬ï¼š
- **éšç§ä¿æŠ¤æ„è¯†**ï¼šæ‹…å¿ƒè¢«è·Ÿè¸ª
- **ä¼ä¸šå®‰å…¨æ”¿ç­–**ï¼šå…¬å¸ç”µè„‘ç»Ÿä¸€ç¦ç”¨
- **ç§»åŠ¨è®¾å¤‡é™åˆ¶**ï¼šæŸäº›ç§»åŠ¨æµè§ˆå™¨é»˜è®¤ç¦ç”¨ç¬¬ä¸‰æ–¹Cookie

**ğŸ“Š ç¦ç”¨Cookieçš„å½±å“èŒƒå›´**

```
ç¦ç”¨Cookieå¯¹ç½‘ç«™åŠŸèƒ½çš„å½±å“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ— æ³•æ­£å¸¸å·¥ä½œ    â”‚ â† è´­ç‰©è½¦ã€ç”¨æˆ·ç™»å½•çŠ¶æ€
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸    â”‚ â† ä¸ªæ€§åŒ–è®¾ç½®ã€æµè§ˆå†å²
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä½“éªŒä¸‹é™       â”‚ â† éœ€è¦é‡å¤è¾“å…¥ä¿¡æ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Cookieå¯ç”¨æ€§æ£€æµ‹


**ğŸ”¸ æœåŠ¡ç«¯æ£€æµ‹æ–¹æ³•**

```java
@WebServlet("/checkCookie")
public class CookieCheckServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) {
        
        // ğŸ”¹ è®¾ç½®æµ‹è¯•Cookie
        Cookie testCookie = new Cookie("cookieTest", "enabled");
        testCookie.setMaxAge(60); // 1åˆ†é’Ÿæœ‰æ•ˆ
        response.addCookie(testCookie);
        
        // ğŸ”¹ é‡å®šå‘åˆ°éªŒè¯é¡µé¢
        response.sendRedirect("verifyCookie");
    }
}

@WebServlet("/verifyCookie")
public class VerifyCookieServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // ğŸ”¹ æ£€æŸ¥æµ‹è¯•Cookieæ˜¯å¦å­˜åœ¨
        boolean cookieEnabled = false;
        Cookie[] cookies = request.getCookies();
        
        if (cookies != null) {
            for (Cookie cookie : cookies) {
                if ("cookieTest".equals(cookie.getName())) {
                    cookieEnabled = true;
                    break;
                }
            }
        }
        
        if (cookieEnabled) {
            response.getWriter().write("CookieåŠŸèƒ½æ­£å¸¸");
        } else {
            response.getWriter().write("æ£€æµ‹åˆ°Cookieè¢«ç¦ç”¨ï¼Œè¯·å¯ç”¨Cookieè·å¾—å®Œæ•´åŠŸèƒ½");
        }
    }
}
```

### 4.3 æ›¿ä»£æ–¹æ¡ˆå®ç°


**ğŸ”¸ URLé‡å†™æŠ€æœ¯**

å½“Cookieä¸å¯ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡URLé‡å†™æ¥ä¼ é€’ä¼šè¯ä¿¡æ¯ï¼š

```java
@WebServlet("/urlRewrite")
public class UrlRewriteServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // ğŸ”¹ è·å–ä¼šè¯ID
        String sessionId = request.getSession().getId();
        
        // ğŸ”¹ æ„å»ºå¸¦æœ‰ä¼šè¯IDçš„URL
        String loginUrl = "login.jsp;jsessionid=" + sessionId;
        String profileUrl = "profile.jsp;jsessionid=" + sessionId;
        
        // ğŸ”¹ æˆ–è€…ä½¿ç”¨encodeURLæ–¹æ³•è‡ªåŠ¨å¤„ç†
        String encodedLoginUrl = response.encodeURL("login.jsp");
        String encodedProfileUrl = response.encodeURL("profile.jsp");
        
        // ğŸ”¹ ç”Ÿæˆå¯¼èˆªé“¾æ¥
        PrintWriter out = response.getWriter();
        out.println("<a href='" + encodedLoginUrl + "'>ç™»å½•</a>");
        out.println("<a href='" + encodedProfileUrl + "'>ä¸ªäººèµ„æ–™</a>");
    }
}
```

**ğŸ”¸ éšè—è¡¨å•å­—æ®µ**

```html
<!-- ğŸ”¹ åœ¨æ¯ä¸ªè¡¨å•ä¸­æ·»åŠ ä¼šè¯ä¿¡æ¯ -->
<form action="submitData" method="post">
    <input type="hidden" name="sessionId" value="${sessionId}">
    <input type="hidden" name="userId" value="${userId}">
    
    <input type="text" name="username" placeholder="ç”¨æˆ·å">
    <input type="submit" value="æäº¤">
</form>
```

### 4.4 ç”¨æˆ·æç¤ºå’Œå¼•å¯¼


**ğŸ”¸ å‹å¥½çš„æç¤ºä¿¡æ¯**

```java
// ğŸ”¹ æ£€æµ‹åˆ°Cookieç¦ç”¨æ—¶çš„ç”¨æˆ·å¼•å¯¼
if (!cookieEnabled) {
    response.setContentType("text/html;charset=UTF-8");
    PrintWriter out = response.getWriter();
    
    out.println("<div style='background: #fff3cd; padding: 15px; border: 1px solid #ffeaa7;'>");
    out.println("<h3>ğŸ”” æ£€æµ‹åˆ°Cookieè¢«ç¦ç”¨</h3>");
    out.println("<p>ä¸ºäº†è·å¾—å®Œæ•´çš„ç½‘ç«™åŠŸèƒ½ï¼Œå»ºè®®æ‚¨ï¼š</p>");
    out.println("<ul>");
    out.println("<li>åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å¯ç”¨Cookie</li>");
    out.println("<li>å°†æœ¬ç«™æ·»åŠ åˆ°å¯ä¿¡ç«™ç‚¹åˆ—è¡¨</li>");
    out.println("<li>åˆ·æ–°é¡µé¢é‡æ–°è®¿é—®</li>");
    out.println("</ul>");
    out.println("</div>");
}
```

---

## 5. âš ï¸ Cookieé™åˆ¶é—®é¢˜åº”å¯¹ç­–ç•¥


### 5.1 Cookieä¸»è¦é™åˆ¶è¯¦è§£


**ğŸ”¸ æ•°é‡é™åˆ¶**

```
æµè§ˆå™¨Cookieæ•°é‡é™åˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯ä¸ªåŸŸå: 50ä¸ª    â”‚ â† å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ€»æ•°: 3000ä¸ª     â”‚ â† æ‰€æœ‰åŸŸååˆè®¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¶…å‡ºé™åˆ¶å:      â”‚ â† åˆ é™¤æœ€æ—§çš„Cookie
â”‚ è‡ªåŠ¨æ¸…ç†æœºåˆ¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ å¤§å°é™åˆ¶**

æ¯ä¸ªCookieçš„å¤§å°é™åˆ¶çº¦ä¸º**4KB**ï¼ŒåŒ…æ‹¬ï¼š
- Cookieåç§°é•¿åº¦
- Cookieå€¼é•¿åº¦  
- æ‰€æœ‰å±æ€§(domainã€pathã€expiresç­‰)

### 5.2 æ•°é‡é™åˆ¶åº”å¯¹ç­–ç•¥


**ğŸ”¸ Cookieåˆå¹¶æŠ€æœ¯**

```java
// âŒ ä½æ•ˆæ–¹å¼ - åˆ›å»ºå¤šä¸ªå•å€¼Cookie
Cookie theme = new Cookie("theme", "dark");
Cookie language = new Cookie("language", "zh-CN");
Cookie pageSize = new Cookie("pageSize", "20");
Cookie sortOrder = new Cookie("sortOrder", "desc");
// å ç”¨4ä¸ªCookieæ§½ä½

// âœ… é«˜æ•ˆæ–¹å¼ - åˆå¹¶ä¸ºå•ä¸ªå¤šå€¼Cookie
String combinedValue = "theme=dark|language=zh-CN|pageSize=20|sortOrder=desc";
Cookie combined = new Cookie("userSettings", combinedValue);
// åªå ç”¨1ä¸ªCookieæ§½ä½
```

**ğŸ”¸ Cookieä¼˜å…ˆçº§ç®¡ç†**

```java
public class CookieManager {
    
    // ğŸ”¹ å®šä¹‰Cookieé‡è¦ç¨‹åº¦
    private static final Map<String, Integer> COOKIE_PRIORITY = new HashMap<>();
    static {
        COOKIE_PRIORITY.put("sessionId", 10);      // æœ€é‡è¦
        COOKIE_PRIORITY.put("userId", 9);          // å¾ˆé‡è¦
        COOKIE_PRIORITY.put("theme", 5);           // ä¸­ç­‰é‡è¦
        COOKIE_PRIORITY.put("lastVisit", 3);       // è¾ƒä¸é‡è¦
        COOKIE_PRIORITY.put("adPrefs", 1);         // æœ€ä¸é‡è¦
    }
    
    // ğŸ”¹ å½“æ¥è¿‘æ•°é‡é™åˆ¶æ—¶ï¼Œæ¸…ç†ä½ä¼˜å…ˆçº§Cookie
    public void cleanupLowPriorityCookies(HttpServletResponse response) {
        // åˆ é™¤ä¼˜å…ˆçº§ä½äº5çš„Cookie
        for (Map.Entry<String, Integer> entry : COOKIE_PRIORITY.entrySet()) {
            if (entry.getValue() < 5) {
                Cookie deleteCookie = new Cookie(entry.getKey(), "");
                deleteCookie.setMaxAge(0);
                deleteCookie.setPath("/");
                response.addCookie(deleteCookie);
            }
        }
    }
}
```

### 5.3 å¤§å°é™åˆ¶åº”å¯¹ç­–ç•¥


**ğŸ”¸ æ•°æ®å‹ç¼©æŠ€æœ¯**

```java
// ğŸ”¹ å¯¹äºè¾ƒå¤§çš„Cookieå€¼ï¼Œè¿›è¡Œç®€å•å‹ç¼©
public class CookieCompressor {
    
    // ç®€å•çš„å­—ç¬¦ä¸²å‹ç¼©ï¼ˆç§»é™¤ç©ºæ ¼ï¼Œä½¿ç”¨ç®€å†™ï¼‰
    public static String compress(String data) {
        return data.replace(" ", "")           // ç§»é™¤ç©ºæ ¼
                  .replace("true", "1")        // å¸ƒå°”å€¼ç®€å†™
                  .replace("false", "0")       // å¸ƒå°”å€¼ç®€å†™
                  .replace("favorite", "fav"); // å¸¸ç”¨è¯ç®€å†™
    }
    
    public static String decompress(String compressed) {
        return compressed.replace("1", "true")
                        .replace("0", "false")
                        .replace("fav", "favorite");
    }
}

// ä½¿ç”¨ç¤ºä¾‹
String originalData = "theme=dark language=zh-CN favorite=true pageSize=20";
String compressed = CookieCompressor.compress(originalData);
Cookie cookie = new Cookie("settings", compressed);
```

**ğŸ”¸ æ•°æ®åˆ†ç‰‡å­˜å‚¨**

```java
// ğŸ”¹ å½“å•ä¸ªæ•°æ®è¶…è¿‡4KBæ—¶ï¼Œåˆ†ç‰‡å­˜å‚¨
public void storelargeData(String data, HttpServletResponse response) {
    
    int chunkSize = 3000; // æ¯ç‰‡3KBï¼Œç•™å‡ºå±æ€§ç©ºé—´
    int totalChunks = (data.length() + chunkSize - 1) / chunkSize;
    
    for (int i = 0; i < totalChunks; i++) {
        int start = i * chunkSize;
        int end = Math.min(start + chunkSize, data.length());
        String chunk = data.substring(start, end);
        
        Cookie chunkCookie = new Cookie("data_chunk_" + i, chunk);
        chunkCookie.setMaxAge(24 * 60 * 60); // 1å¤©
        chunkCookie.setPath("/");
        response.addCookie(chunkCookie);
    }
    
    // å­˜å‚¨æ€»ç‰‡æ•°ä¿¡æ¯
    Cookie totalCookie = new Cookie("data_total_chunks", String.valueOf(totalChunks));
    totalCookie.setMaxAge(24 * 60 * 60);
    response.addCookie(totalCookie);
}
```

### 5.4 æ›¿ä»£å­˜å‚¨æ–¹æ¡ˆ


**ğŸ”¸ ç»“åˆSessionä½¿ç”¨**

```java
// ğŸ”¹ é‡è¦æ•°æ®æ”¾Sessionï¼Œæ¬¡è¦æ•°æ®æ”¾Cookie
public void hybridStorage(HttpServletRequest request, 
                         HttpServletResponse response) {
    
    // æ ¸å¿ƒæ•°æ®æ”¾Sessionï¼ˆæœåŠ¡ç«¯å­˜å‚¨ï¼‰
    HttpSession session = request.getSession();
    session.setAttribute("userId", "12345");
    session.setAttribute("userRole", "admin");
    
    // ç”¨æˆ·åå¥½æ”¾Cookieï¼ˆå®¢æˆ·ç«¯å­˜å‚¨ï¼‰
    Cookie themeCookie = new Cookie("theme", "dark");
    Cookie langCookie = new Cookie("language", "zh-CN");
    response.addCookie(themeCookie);
    response.addCookie(langCookie);
}
```

**ğŸ”¸ æœ¬åœ°å­˜å‚¨æç¤º**

å½“Cookieé™åˆ¶æˆä¸ºé—®é¢˜æ—¶ï¼Œå¯ä»¥å¼•å¯¼ç”¨æˆ·ä½¿ç”¨ç°ä»£æµè§ˆå™¨çš„æœ¬åœ°å­˜å‚¨ï¼š

```html
<!-- ğŸ”¹ JavaScriptæœ¬åœ°å­˜å‚¨ä½œä¸ºCookieè¡¥å…… -->
<script>
// æ£€æŸ¥æœ¬åœ°å­˜å‚¨æ”¯æŒ
if (typeof(Storage) !== "undefined") {
    // å¯ä»¥ä½¿ç”¨localStorageä½œä¸ºCookieçš„è¡¥å……
    localStorage.setItem("userPreferences", JSON.stringify({
        theme: "dark",
        language: "zh-CN",
        complexData: "large_amount_of_data"
    }));
} else {
    // ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨ï¼Œæç¤ºç”¨æˆ·å‡çº§æµè§ˆå™¨
    alert("å»ºè®®å‡çº§æµè§ˆå™¨ä»¥è·å¾—æ›´å¥½çš„ä½“éªŒ");
}
</script>
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Cookieæ›´æ–°æœ¬è´¨ï¼šåŒååŒåŸŸåŒè·¯å¾„çš„è¦†ç›–æœºåˆ¶
ğŸ”¸ Cookieåˆ é™¤åŸç†ï¼šè®¾ç½®MaxAge=0è®©Cookieç«‹å³è¿‡æœŸ
ğŸ”¸ å¤šå€¼å­˜å‚¨ä¼˜åŠ¿ï¼šå‡å°‘Cookieæ•°é‡ï¼Œæé«˜å­˜å‚¨æ•ˆç‡
ğŸ”¸ æµè§ˆå™¨ç¦ç”¨ç°å®ï¼šéœ€è¦å‡†å¤‡æ›¿ä»£æ–¹æ¡ˆä¿è¯åŠŸèƒ½
ğŸ”¸ Cookieé™åˆ¶åº”å¯¹ï¼šåˆå¹¶ã€å‹ç¼©ã€åˆ†ç‰‡ç­‰æŠ€æœ¯æ‰‹æ®µ
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ›´æ–°å’Œåˆ é™¤çš„ç»Ÿä¸€æ€§**
```
Cookieæ“ä½œçš„æœ¬è´¨éƒ½æ˜¯"åˆ›å»ºæ–°Cookie"ï¼š
â€¢ æ›´æ–° = åˆ›å»ºåŒåCookieè¦†ç›–æ—§å€¼
â€¢ åˆ é™¤ = åˆ›å»ºåŒåCookieå¹¶è®¾ç½®ç«‹å³è¿‡æœŸ
â€¢ å…³é”® = nameã€domainã€pathå¿…é¡»å®Œå…¨åŒ¹é…
```

**ğŸ”¹ å¤šå€¼å­˜å‚¨çš„é€‰æ‹©ç­–ç•¥**
```
æ•°æ®ç±»å‹åˆ¤æ–­ï¼š
â€¢ ç®€å•åˆ—è¡¨ â†’ åˆ†éš”ç¬¦æ ¼å¼ (item1,item2,item3)
â€¢ é”®å€¼å¯¹ â†’ è‡ªå®šä¹‰æ ¼å¼ (key1=val1|key2=val2)  
â€¢ å¤æ‚ç»“æ„ â†’ JSONæ ¼å¼ ({"key":"value"})
```

**ğŸ”¹ é™åˆ¶é—®é¢˜çš„é¢„é˜²æ€ç»´**
```
å¼€å‘æ—¶çš„è€ƒè™‘é¡ºåºï¼š
1. è¿™ä¸ªæ•°æ®çœŸçš„éœ€è¦å­˜Cookieå—ï¼Ÿ
2. èƒ½å¦ä¸å…¶ä»–æ•°æ®åˆå¹¶å­˜å‚¨ï¼Ÿ
3. æ˜¯å¦å¯ä»¥ä½¿ç”¨Sessionæ›¿ä»£ï¼Ÿ
4. ç”¨æˆ·ç¦ç”¨Cookieæ—¶æ€ä¹ˆåŠï¼Ÿ
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¼ä¸šçº§å¼€å‘åœºæ™¯**
- **ç”µå•†ç½‘ç«™**ï¼šè´­ç‰©è½¦æ•°æ®çš„Cookieå­˜å‚¨å’Œæ›´æ–°
- **å†…å®¹ç®¡ç†**ï¼šç”¨æˆ·åå¥½è®¾ç½®çš„å¤šå€¼å­˜å‚¨
- **ä¼ä¸šåº”ç”¨**ï¼šä¼šè¯ç®¡ç†çš„Cookieç¦ç”¨é™çº§æ–¹æ¡ˆ
- **ç§»åŠ¨åº”ç”¨**ï¼šH5é¡µé¢çš„Cookieé™åˆ¶åº”å¯¹

**ğŸ”§ å¼€å‘å®è·µå»ºè®®**
- **è®¾è®¡é˜¶æ®µ**ï¼šæå‰è§„åˆ’Cookieä½¿ç”¨ç­–ç•¥ï¼Œé¿å…åæœŸé™åˆ¶é—®é¢˜
- **ç¼–ç é˜¶æ®µ**ï¼šç»Ÿä¸€Cookieæ“ä½œçš„å·¥å…·ç±»ï¼Œç¡®ä¿è·¯å¾„åŸŸåä¸€è‡´æ€§
- **æµ‹è¯•é˜¶æ®µ**ï¼šæ¨¡æ‹ŸCookieç¦ç”¨æƒ…å†µï¼ŒéªŒè¯é™çº§æ–¹æ¡ˆå¯ç”¨æ€§
- **è¿ç»´é˜¶æ®µ**ï¼šç›‘æ§Cookieä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜

**ğŸŒŸ å­¦ä¹ è¿›é˜¶æ–¹å‘**
- **æ·±å…¥Session**ï¼šç†è§£Cookieä¸Sessionçš„é…åˆå…³ç³»
- **å‰ç«¯å­˜å‚¨**ï¼šlocalStorageã€sessionStorageç­‰ç°ä»£å­˜å‚¨API
- **å®‰å…¨è€ƒè™‘**ï¼šCookieçš„å®‰å…¨å±æ€§å’ŒXSSé˜²æŠ¤
- **æ€§èƒ½ä¼˜åŒ–**ï¼šCookieå¯¹HTTPè¯·æ±‚æ€§èƒ½çš„å½±å“åˆ†æ

**æ ¸å¿ƒè®°å¿†è¦è¯€**ï¼š
- Cookieæ›´æ–°åˆ é™¤æœ¬è´¨åŒï¼ŒåŒååŒåŸŸè¦†ç›–é€š
- å¤šå€¼å­˜å‚¨æ•ˆç‡é«˜ï¼ŒJSONåˆ†éš”æŒ‰éœ€è¦  
- ç¦ç”¨é™åˆ¶è¦é¢„æ¡ˆï¼Œæ£€æµ‹é™çº§ä¿åŠŸèƒ½
- åˆå¹¶å‹ç¼©æ§æ•°é‡ï¼Œé‡è¦æ¬¡è¦åˆ†ä¼˜å…ˆ