---
title: 2ã€Servletå¼‚æ­¥å¤„ç†
---
## ğŸ“š ç›®å½•

1. [å¼‚æ­¥å¤„ç†åŸºæœ¬æ¦‚å¿µ](#1-å¼‚æ­¥å¤„ç†åŸºæœ¬æ¦‚å¿µ)
2. [AsyncContextå¼‚æ­¥ä¸Šä¸‹æ–‡](#2-AsyncContextå¼‚æ­¥ä¸Šä¸‹æ–‡)
3. [å¼‚æ­¥Servleté…ç½®ä¸å®ç°](#3-å¼‚æ­¥Servleté…ç½®ä¸å®ç°)
4. [å¼‚æ­¥å¤„ç†æ ¸å¿ƒæœºåˆ¶](#4-å¼‚æ­¥å¤„ç†æ ¸å¿ƒæœºåˆ¶)
5. [å¼‚æ­¥å¤„ç†å®é™…åº”ç”¨åœºæ™¯](#5-å¼‚æ­¥å¤„ç†å®é™…åº”ç”¨åœºæ™¯)
6. [çº¿ç¨‹æ± ç®¡ç†ä¸ä¼˜åŒ–](#6-çº¿ç¨‹æ± ç®¡ç†ä¸ä¼˜åŒ–)
7. [è¶…æ—¶å¤„ç†ä¸å¼‚å¸¸ç®¡ç†](#7-è¶…æ—¶å¤„ç†ä¸å¼‚å¸¸ç®¡ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŸ å¼‚æ­¥å¤„ç†åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Servletå¼‚æ­¥å¤„ç†


> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> ä¼ ç»ŸServletå°±åƒé“¶è¡Œåªæœ‰ä¸€ä¸ªçª—å£ï¼Œæ¯ä¸ªå®¢æˆ·å¿…é¡»æ’é˜Ÿç­‰å‰é¢çš„äººåŠå®Œæ‰èƒ½åŠç†ã€‚  
> å¼‚æ­¥Servletå°±åƒé“¶è¡Œæœ‰ä¸“é—¨çš„å«å·ç³»ç»Ÿï¼Œä½ å–å·åå¯ä»¥å»ä¼‘æ¯ï¼Œè½®åˆ°ä½ æ—¶å†æ¥åŠç†ã€‚

**ğŸ”¸ ä¼ ç»ŸåŒæ­¥å¤„ç†çš„é—®é¢˜**
```
å®¢æˆ·ç«¯è¯·æ±‚ â”€â”€â”€â”€â”€â”€> Servletå®¹å™¨
     â†“              â†“
ç­‰å¾…å“åº”ä¸­...      å ç”¨çº¿ç¨‹å¤„ç†
     â†“              â†“
æ¥æ”¶å®Œæ•´å“åº” <â”€â”€â”€â”€â”€â”€  å¤„ç†å®Œæˆé‡Šæ”¾çº¿ç¨‹

é—®é¢˜ï¼šä¸€ä¸ªçº¿ç¨‹ä»å¤´åˆ°å°¾è¢«å ç”¨ï¼Œæ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚
```

**ğŸ”¸ å¼‚æ­¥å¤„ç†çš„ä¼˜åŠ¿**
```
å®¢æˆ·ç«¯è¯·æ±‚ â”€â”€â”€â”€â”€â”€> Servletå®¹å™¨
     â†“              â†“
ç«‹å³è¿”å›å·ç ç‰Œ     å¯åŠ¨å¼‚æ­¥ï¼Œé‡Šæ”¾çº¿ç¨‹
     â†“              â†“ 
ç­‰å¾…é€šçŸ¥...       çº¿ç¨‹å¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚
     â†“              â†“
æ”¶åˆ°å®Œæˆé€šçŸ¥ <â”€â”€â”€â”€â”€â”€  å¼‚æ­¥ä»»åŠ¡å®Œæˆ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥å¤„ç†


**ğŸ“Š æ€§èƒ½å¯¹æ¯”åˆ†æ**

| **å¤„ç†æ–¹å¼** | **çº¿ç¨‹ä½¿ç”¨** | **å¹¶å‘èƒ½åŠ›** | **é€‚ç”¨åœºæ™¯** |
|------------|------------|------------|------------|
| **åŒæ­¥å¤„ç†** | `ä¸€è¯·æ±‚ä¸€çº¿ç¨‹ï¼Œå…¨ç¨‹å ç”¨` | `å—çº¿ç¨‹æ± å¤§å°é™åˆ¶` | `å¿«é€Ÿå“åº”çš„ç®€å•æ“ä½œ` |
| **å¼‚æ­¥å¤„ç†** | `è¯·æ±‚æ—¶å ç”¨ï¼Œå¤„ç†æ—¶é‡Šæ”¾` | `å¤§å¹…æå‡å¹¶å‘æ•°` | `è€—æ—¶æ“ä½œã€é•¿è¿æ¥` |

**ğŸ¯ æ ¸å¿ƒä»·å€¼**
- **æå‡å¹¶å‘èƒ½åŠ›**ï¼šä¸€ä¸ªçº¿ç¨‹æ± å¯ä»¥å¤„ç†æ›´å¤šè¯·æ±‚
- **èµ„æºä¼˜åŒ–**ï¼šé¿å…çº¿ç¨‹é•¿æ—¶é—´ç­‰å¾…æµªè´¹
- **ç”¨æˆ·ä½“éªŒ**ï¼šé•¿æ—¶é—´æ“ä½œä¸ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šé˜²æ­¢çº¿ç¨‹æ± è€—å°½å¯¼è‡´ç³»ç»Ÿå´©æºƒ

### 1.3 å¼‚æ­¥å¤„ç†çš„å…¸å‹åœºæ™¯


**ğŸ“‹ å®é™…åº”ç”¨ä¸¾ä¾‹**

```
ğŸ”¸ æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ï¼šå¤§æ–‡ä»¶ä¼ è¾“è€—æ—¶é•¿
ğŸ”¸ æ•°æ®åº“å¤æ‚æŸ¥è¯¢ï¼šç»Ÿè®¡åˆ†æç±»æŸ¥è¯¢
ğŸ”¸ ç¬¬ä¸‰æ–¹APIè°ƒç”¨ï¼šç½‘ç»œè¯·æ±‚å“åº”ä¸ç¡®å®š
ğŸ”¸ é‚®ä»¶å‘é€ï¼šSMTPè¿æ¥å’Œå‘é€è¿‡ç¨‹
ğŸ”¸ é•¿è½®è¯¢ï¼šèŠå¤©å®¤ã€å®æ—¶é€šçŸ¥ç³»ç»Ÿ
ğŸ”¸ æ•°æ®å¯¼å…¥å¯¼å‡ºï¼šæ‰¹é‡æ•°æ®å¤„ç†
```

---

## 2. ğŸ”§ AsyncContextå¼‚æ­¥ä¸Šä¸‹æ–‡


### 2.1 AsyncContextæ ¸å¿ƒæ¦‚å¿µ


**ğŸ“– æ ¸å¿ƒå®šä¹‰**
> AsyncContextæ˜¯Servlet 3.0å¼•å…¥çš„å¼‚æ­¥ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå®ƒåƒä¸€ä¸ª"ä»»åŠ¡æ´¾å‘å•"ï¼Œè®°å½•äº†å½“å‰è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè®©ä½ å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ç»§ç»­å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚

**ğŸ§  è®°å¿†æŠ€å·§**
```
AsyncContext = Async(å¼‚æ­¥) + Context(ä¸Šä¸‹æ–‡)
å°±æ˜¯"å¼‚æ­¥å¤„ç†æ—¶çš„è¯·æ±‚ç¯å¢ƒä¿å­˜å™¨"
```

### 2.2 AsyncContextçš„ç”Ÿå‘½å‘¨æœŸ


**ğŸ“Š ç”Ÿå‘½å‘¨æœŸæµç¨‹**
```
HTTPè¯·æ±‚åˆ°è¾¾
       â†“
Servletæ¥æ”¶è¯·æ±‚
       â†“  
è°ƒç”¨startAsync()åˆ›å»ºAsyncContext
       â†“
åŸçº¿ç¨‹é‡Šæ”¾ï¼ŒAsyncContextä¿å­˜è¯·æ±‚çŠ¶æ€
       â†“
å¼‚æ­¥çº¿ç¨‹è·å–AsyncContextç»§ç»­å¤„ç†
       â†“
å¤„ç†å®Œæˆåè°ƒç”¨complete()
       â†“
å“åº”è¿”å›å®¢æˆ·ç«¯ï¼ŒAsyncContexté”€æ¯
```

**â±ï¸ æ—¶é—´è½´å±•ç¤º**
```
æ—¶é—´: 0ms    50ms    100ms   500ms   1000ms
      |       |       |       |       |
   å¯åŠ¨å¼‚æ­¥ â”€â”€â”€â”€â”€â”€> é‡Šæ”¾çº¿ç¨‹ â”€â”€â”€â”€â”€> å¼‚æ­¥å¤„ç† â”€â”€> å®Œæˆå“åº”
      â†“                              â†“
   åˆ›å»ºContext                    è°ƒç”¨complete()
```

### 2.3 AsyncContextæ ¸å¿ƒæ–¹æ³•è¯¦è§£


**ğŸ” ä¸»è¦APIæ–¹æ³•**

| **æ–¹æ³•å** | **ä½œç”¨è¯´æ˜** | **ä½¿ç”¨åœºæ™¯** |
|-----------|------------|------------|
| `getRequest()` | **è·å–åŸå§‹è¯·æ±‚å¯¹è±¡** | `è¯»å–è¯·æ±‚å‚æ•°ã€å¤´ä¿¡æ¯` |
| `getResponse()` | **è·å–å“åº”å¯¹è±¡** | `å†™å…¥å“åº”æ•°æ®` |
| `complete()` | **å®Œæˆå¼‚æ­¥å¤„ç†** | `å¤„ç†ç»“æŸï¼Œå‘é€å“åº”` |
| `dispatch()` | **è½¬å‘åˆ°å…¶ä»–èµ„æº** | `è½¬å‘åˆ°JSPæˆ–å…¶ä»–Servlet` |
| `setTimeout()` | **è®¾ç½®è¶…æ—¶æ—¶é—´** | `é˜²æ­¢å¼‚æ­¥ä»»åŠ¡æ— é™ç­‰å¾…` |
| `addListener()` | **æ·»åŠ ç›‘å¬å™¨** | `ç›‘å¬å¼‚æ­¥äº‹ä»¶` |

---

## 3. âš¡ å¼‚æ­¥Servleté…ç½®ä¸å®ç°


### 3.1 å¯ç”¨å¼‚æ­¥æ”¯æŒ


**ğŸ”§ æ³¨è§£é…ç½®æ–¹å¼**
```java
@WebServlet(
    value = "/async", 
    asyncSupported = true  // å…³é”®ï¼šå¯ç”¨å¼‚æ­¥æ”¯æŒ
)
public class AsyncServlet extends HttpServlet {
    // Servletå®ç°
}
```

**ğŸ”§ web.xmlé…ç½®æ–¹å¼**
```xml
<servlet>
    <servlet-name>AsyncServlet</servlet-name>
    <servlet-class>com.example.AsyncServlet</servlet-class>
    <async-supported>true</async-supported>
</servlet>
```

> âš ï¸ **é‡è¦æé†’**  
> å¦‚æœä¸è®¾ç½®`asyncSupported=true`ï¼Œè°ƒç”¨startAsync()æ–¹æ³•ä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ï¼

### 3.2 åŸºç¡€å¼‚æ­¥Servletå®ç°


**ğŸ’» ç®€å•å¼‚æ­¥å¤„ç†ç¤ºä¾‹**
```java
@WebServlet(value = "/simple-async", asyncSupported = true)
public class SimpleAsyncServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // 1. å¯åŠ¨å¼‚æ­¥å¤„ç†
        AsyncContext asyncContext = request.startAsync();
        
        // 2. è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆå¯é€‰ï¼‰
        asyncContext.setTimeout(30000); // 30ç§’
        
        // 3. åœ¨æ–°çº¿ç¨‹ä¸­å¤„ç†ä¸šåŠ¡é€»è¾‘
        CompletableFuture.runAsync(() -> {
            try {
                // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
                Thread.sleep(5000);
                
                // 4. è·å–å“åº”å¯¹è±¡å¹¶å†™å…¥ç»“æœ
                HttpServletResponse resp = 
                    (HttpServletResponse) asyncContext.getResponse();
                resp.setContentType("text/plain;charset=UTF-8");
                resp.getWriter().write("å¼‚æ­¥å¤„ç†å®Œæˆï¼è€—æ—¶5ç§’");
                
                // 5. å®Œæˆå¼‚æ­¥å¤„ç†
                asyncContext.complete();
                
            } catch (Exception e) {
                e.printStackTrace();
            }
        });
        
        // åŸçº¿ç¨‹ç«‹å³è¿”å›ï¼Œä¸é˜»å¡
        System.out.println("ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡...");
    }
}
```

**ğŸ” ä»£ç è§£æ**
- â‘ ï¸âƒ£ `request.startAsync()`ï¼šåˆ›å»ºå¼‚æ­¥ä¸Šä¸‹æ–‡ï¼Œå‘Šè¯‰å®¹å™¨è¿™æ˜¯å¼‚æ­¥è¯·æ±‚
- â‘¡ï¸âƒ£ `asyncContext.setTimeout()`ï¼šé˜²æ­¢å¼‚æ­¥ä»»åŠ¡æ°¸è¿œä¸å®Œæˆ
- â‘¢ï¸âƒ£ `CompletableFuture.runAsync()`ï¼šåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œè€—æ—¶ä»»åŠ¡
- â‘£ï¸âƒ£ `asyncContext.getResponse()`ï¼šè·å–å“åº”å¯¹è±¡å†™å…¥ç»“æœ
- â‘¤ï¸âƒ£ `asyncContext.complete()`ï¼šå‘Šè¯‰å®¹å™¨å¼‚æ­¥å¤„ç†å®Œæˆ

### 3.3 å¸¦å‚æ•°ä¼ é€’çš„å¼‚æ­¥å¤„ç†


**ğŸ’» å®é™…ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹**
```java
@WebServlet(value = "/data-process", asyncSupported = true)
public class DataProcessAsyncServlet extends HttpServlet {
    
    private ExecutorService executor = Executors.newFixedThreadPool(10);
    
    @Override
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws IOException {
        
        // è·å–è¯·æ±‚å‚æ•°
        String dataType = request.getParameter("type");
        String userId = request.getParameter("userId");
        
        // å¯åŠ¨å¼‚æ­¥
        AsyncContext asyncContext = request.startAsync();
        asyncContext.setTimeout(60000); // 1åˆ†é’Ÿè¶…æ—¶
        
        // æäº¤å¼‚æ­¥ä»»åŠ¡
        executor.submit(() -> {
            try {
                // æ¨¡æ‹Ÿæ•°æ®å¤„ç†
                String result = processData(dataType, userId);
                
                // è¿”å›ç»“æœ
                HttpServletResponse resp = 
                    (HttpServletResponse) asyncContext.getResponse();
                resp.setContentType("application/json;charset=UTF-8");
                resp.getWriter().write(result);
                
                asyncContext.complete();
                
            } catch (Exception e) {
                handleAsyncError(asyncContext, e);
            }
        });
    }
    
    private String processData(String type, String userId) {
        // æ¨¡æ‹Ÿå¤æ‚æ•°æ®å¤„ç†
        try {
            Thread.sleep(10000); // æ¨¡æ‹Ÿ10ç§’å¤„ç†æ—¶é—´
            return "{\"status\":\"success\",\"message\":\"æ•°æ®å¤„ç†å®Œæˆ\"}";
        } catch (InterruptedException e) {
            return "{\"status\":\"error\",\"message\":\"å¤„ç†ä¸­æ–­\"}";
        }
    }
    
    private void handleAsyncError(AsyncContext context, Exception e) {
        try {
            HttpServletResponse response = 
                (HttpServletResponse) context.getResponse();
            response.setStatus(500);
            response.getWriter().write("å¤„ç†å¤±è´¥: " + e.getMessage());
            context.complete();
        } catch (IOException ioException) {
            ioException.printStackTrace();
        }
    }
}
```

---

## 4. ğŸ”„ å¼‚æ­¥å¤„ç†æ ¸å¿ƒæœºåˆ¶


### 4.1 startAsync()æ–¹æ³•è¯¦è§£


**ğŸ”¸ æ–¹æ³•ç­¾åä¸é‡è½½**
```java
// æ–¹å¼1ï¼šä½¿ç”¨å½“å‰requestå’Œresponse
AsyncContext startAsync()

// æ–¹å¼2ï¼šè‡ªå®šä¹‰requestå’Œresponse
AsyncContext startAsync(ServletRequest request, ServletResponse response)
```

**ğŸ”¸ å†…éƒ¨å·¥ä½œæœºåˆ¶**
```
è°ƒç”¨startAsync()åå‘ç”Ÿçš„äº‹æƒ…ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ£€æŸ¥asyncSupportedæ˜¯å¦ä¸ºtrue  â”‚
â”‚ 2. åˆ›å»ºAsyncContextå¯¹è±¡         â”‚
â”‚ 3. ä¿å­˜å½“å‰è¯·æ±‚/å“åº”çŠ¶æ€         â”‚
â”‚ 4. æ ‡è®°è¯·æ±‚ä¸ºå¼‚æ­¥æ¨¡å¼           â”‚
â”‚ 5. è¿”å›AsyncContextç»™åº”ç”¨ä»£ç     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å¼‚æ­¥çº¿ç¨‹ä¸åŸå§‹çº¿ç¨‹çš„å…³ç³»


**ğŸ“Š çº¿ç¨‹åˆ‡æ¢å›¾ç¤º**
```
åŸå§‹è¯·æ±‚çº¿ç¨‹ (Thread-1)
       â†“
   æ¥æ”¶HTTPè¯·æ±‚
       â†“
   è°ƒç”¨startAsync()
       â†“                    å¼‚æ­¥å·¥ä½œçº¿ç¨‹ (Thread-2)
   åˆ›å»ºAsyncContext â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘
       â†“                              â†“
   çº¿ç¨‹é‡Šæ”¾å›çº¿ç¨‹æ±  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¤„ç†å®Œæˆè°ƒç”¨complete()
       â†“
   å¯ä»¥å¤„ç†æ–°è¯·æ±‚
```

**ğŸ’¡ å…³é”®ç†è§£**
- åŸå§‹çº¿ç¨‹ï¼šè´Ÿè´£æ¥æ”¶è¯·æ±‚ï¼Œå¯åŠ¨å¼‚æ­¥åç«‹å³é‡Šæ”¾
- å¼‚æ­¥çº¿ç¨‹ï¼šè´Ÿè´£å®é™…ä¸šåŠ¡å¤„ç†ï¼Œå¯ä»¥æ˜¯ä»»æ„çº¿ç¨‹
- AsyncContextï¼šä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„æ¡¥æ¢ï¼Œä¿å­˜è¯·æ±‚çŠ¶æ€

### 4.3 å¼‚æ­¥å“åº”æœºåˆ¶


**ğŸ” å“åº”å†™å…¥æ—¶æœº**
```java
// âŒ é”™è¯¯åšæ³•ï¼šåœ¨åŸçº¿ç¨‹å†™å“åº”
@Override
protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    AsyncContext asyncContext = request.startAsync();
    
    // é”™è¯¯ï¼šè¿™æ—¶è¿˜åœ¨åŸçº¿ç¨‹ï¼Œå¼‚æ­¥è¿˜æ²¡å¼€å§‹
    response.getWriter().write("è¿™æ ·å†™æ˜¯é”™è¯¯çš„ï¼");
    
    asyncContext.complete();
}

// âœ… æ­£ç¡®åšæ³•ï¼šåœ¨å¼‚æ­¥çº¿ç¨‹å†™å“åº”
@Override
protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    AsyncContext asyncContext = request.startAsync();
    
    new Thread(() -> {
        try {
            // æ­£ç¡®ï¼šåœ¨å¼‚æ­¥çº¿ç¨‹ä¸­è·å–å“åº”å¯¹è±¡
            HttpServletResponse resp = 
                (HttpServletResponse) asyncContext.getResponse();
            resp.getWriter().write("å¼‚æ­¥å“åº”æ­£ç¡®å†™æ³•ï¼");
            asyncContext.complete();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }).start();
}
```

---

## 5. ğŸŒ å¼‚æ­¥å¤„ç†å®é™…åº”ç”¨åœºæ™¯


### 5.1 é•¿è¿æ¥èŠå¤©å®¤å®ç°


**ğŸ’¬ WebSocketæ›¿ä»£æ–¹æ¡ˆ**
```java
@WebServlet(value = "/chat-room", asyncSupported = true)
public class ChatRoomServlet extends HttpServlet {
    
    // ä¿å­˜æ‰€æœ‰ç­‰å¾…æ¶ˆæ¯çš„å¼‚æ­¥ä¸Šä¸‹æ–‡
    private static final List<AsyncContext> waitingClients = 
        Collections.synchronizedList(new ArrayList<>());
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        String action = request.getParameter("action");
        
        if ("listen".equals(action)) {
            // å®¢æˆ·ç«¯ç­‰å¾…æ–°æ¶ˆæ¯
            AsyncContext asyncContext = request.startAsync();
            asyncContext.setTimeout(300000); // 5åˆ†é’Ÿè¶…æ—¶
            
            // æ·»åŠ è¶…æ—¶ç›‘å¬
            asyncContext.addListener(new AsyncListener() {
                @Override
                public void onTimeout(AsyncEvent event) {
                    waitingClients.remove(asyncContext);
                    try {
                        HttpServletResponse resp = 
                            (HttpServletResponse) event.getAsyncContext().getResponse();
                        resp.getWriter().write("è¶…æ—¶ï¼Œè¯·é‡æ–°è¿æ¥");
                        event.getAsyncContext().complete();
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }
                
                @Override public void onComplete(AsyncEvent event) {}
                @Override public void onError(AsyncEvent event) {}
                @Override public void onStartAsync(AsyncEvent event) {}
            });
            
            waitingClients.add(asyncContext);
            
        } else if ("send".equals(action)) {
            // å‘é€æ¶ˆæ¯ç»™æ‰€æœ‰ç­‰å¾…çš„å®¢æˆ·ç«¯
            String message = request.getParameter("message");
            broadcastMessage(message);
            
            response.setContentType("text/plain;charset=UTF-8");
            response.getWriter().write("æ¶ˆæ¯å·²å‘é€");
        }
    }
    
    private void broadcastMessage(String message) {
        // å‘æ‰€æœ‰ç­‰å¾…çš„å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
        Iterator<AsyncContext> iterator = waitingClients.iterator();
        while (iterator.hasNext()) {
            AsyncContext context = iterator.next();
            try {
                HttpServletResponse response = 
                    (HttpServletResponse) context.getResponse();
                response.setContentType("text/plain;charset=UTF-8");
                response.getWriter().write("æ–°æ¶ˆæ¯: " + message);
                context.complete();
                iterator.remove();
            } catch (IOException e) {
                iterator.remove(); // ç§»é™¤å¤±æ•ˆçš„è¿æ¥
            }
        }
    }
}
```

### 5.2 æ–‡ä»¶ä¸Šä¼ è¿›åº¦è·Ÿè¸ª


**ğŸ“ å¤§æ–‡ä»¶ä¸Šä¼ ç›‘æ§**
```java
@WebServlet(value = "/file-upload", asyncSupported = true)
@MultipartConfig(maxFileSize = 100 * 1024 * 1024) // 100MB
public class FileUploadProgressServlet extends HttpServlet {
    
    // å­˜å‚¨ä¸Šä¼ è¿›åº¦
    private static final Map<String, Integer> uploadProgress = 
        new ConcurrentHashMap<>();
    
    @Override
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws IOException, ServletException {
        
        String action = request.getParameter("action");
        
        if ("upload".equals(action)) {
            handleFileUpload(request, response);
        } else if ("progress".equals(action)) {
            handleProgressQuery(request, response);
        }
    }
    
    private void handleFileUpload(HttpServletRequest request, 
                                 HttpServletResponse response) throws IOException, ServletException {
        String uploadId = request.getParameter("uploadId");
        AsyncContext asyncContext = request.startAsync();
        
        CompletableFuture.runAsync(() -> {
            try {
                Part filePart = request.getPart("file");
                long fileSize = filePart.getSize();
                
                // æ¨¡æ‹Ÿåˆ†å—ä¸Šä¼ 
                for (int i = 0; i <= 100; i += 10) {
                    uploadProgress.put(uploadId, i);
                    Thread.sleep(500); // æ¨¡æ‹Ÿä¸Šä¼ æ—¶é—´
                }
                
                // å®Œæˆä¸Šä¼ 
                uploadProgress.put(uploadId, 100);
                
                HttpServletResponse resp = 
                    (HttpServletResponse) asyncContext.getResponse();
                resp.setContentType("application/json;charset=UTF-8");
                resp.getWriter().write("{\"status\":\"success\",\"message\":\"ä¸Šä¼ å®Œæˆ\"}");
                
                asyncContext.complete();
                
            } catch (Exception e) {
                uploadProgress.put(uploadId, -1); // æ ‡è®°å¤±è´¥
                e.printStackTrace();
            }
        });
    }
    
    private void handleProgressQuery(HttpServletRequest request, 
                                   HttpServletResponse response) throws IOException {
        String uploadId = request.getParameter("uploadId");
        Integer progress = uploadProgress.get(uploadId);
        
        response.setContentType("application/json;charset=UTF-8");
        if (progress == null) {
            response.getWriter().write("{\"progress\":0,\"status\":\"not_started\"}");
        } else if (progress == -1) {
            response.getWriter().write("{\"progress\":0,\"status\":\"error\"}");
        } else {
            response.getWriter().write("{\"progress\":" + progress + ",\"status\":\"uploading\"}");
        }
    }
}
```

### 5.3 æ•°æ®åº“é•¿æŸ¥è¯¢å¤„ç†


**ğŸ“Š å¤æ‚æŠ¥è¡¨ç”Ÿæˆ**
```java
@WebServlet(value = "/report-generate", asyncSupported = true)
public class ReportGeneratorServlet extends HttpServlet {
    
    private ExecutorService reportExecutor = Executors.newFixedThreadPool(5);
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        String reportType = request.getParameter("type");
        String startDate = request.getParameter("startDate");
        String endDate = request.getParameter("endDate");
        
        AsyncContext asyncContext = request.startAsync();
        asyncContext.setTimeout(300000); // 5åˆ†é’Ÿè¶…æ—¶
        
        reportExecutor.submit(() -> {
            try {
                // æ¨¡æ‹Ÿå¤æ‚æ•°æ®åº“æŸ¥è¯¢
                String reportData = generateComplexReport(reportType, startDate, endDate);
                
                HttpServletResponse resp = 
                    (HttpServletResponse) asyncContext.getResponse();
                resp.setContentType("application/json;charset=UTF-8");
                resp.getWriter().write(reportData);
                
                asyncContext.complete();
                
            } catch (Exception e) {
                handleReportError(asyncContext, e);
            }
        });
    }
    
    private String generateComplexReport(String type, String start, String end) {
        try {
            // æ¨¡æ‹Ÿå¤æ‚æŸ¥è¯¢å¤„ç†æ—¶é—´
            Thread.sleep(30000); // 30ç§’å¤„ç†æ—¶é—´
            
            return "{\"reportType\":\"" + type + "\",\"data\":[{\"é”€å”®é¢\":1000000}]}";
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            throw new RuntimeException("æŠ¥è¡¨ç”Ÿæˆè¢«ä¸­æ–­", e);
        }
    }
    
    private void handleReportError(AsyncContext context, Exception e) {
        try {
            HttpServletResponse response = (HttpServletResponse) context.getResponse();
            response.setStatus(500);
            response.setContentType("application/json;charset=UTF-8");
            response.getWriter().write(
                "{\"error\":\"æŠ¥è¡¨ç”Ÿæˆå¤±è´¥\",\"message\":\"" + e.getMessage() + "\"}"
            );
            context.complete();
        } catch (IOException ioException) {
            ioException.printStackTrace();
        }
    }
}
```

---

## 6. ğŸ§µ çº¿ç¨‹æ± ç®¡ç†ä¸ä¼˜åŒ–


### 6.1 å¼‚æ­¥çº¿ç¨‹æ± é…ç½®


**âš™ï¸ çº¿ç¨‹æ± è®¾è®¡åŸåˆ™**

> ğŸ’¡ **ç±»æ¯”è¯´æ˜**  
> çº¿ç¨‹æ± å°±åƒé¤å…çš„å¨æˆ¿ï¼Œæ ¸å¿ƒçº¿ç¨‹æ˜¯å›ºå®šå¨å¸ˆï¼Œæœ€å¤§çº¿ç¨‹æ˜¯å¿™æ—¶ä¸´æ—¶å¨å¸ˆï¼Œé˜Ÿåˆ—æ˜¯å¾…å¤„ç†è®¢å•ã€‚

**ğŸ“Š çº¿ç¨‹æ± å‚æ•°é…ç½®**
```java
public class AsyncThreadPoolConfig {
    
    // CPUå¯†é›†å‹ä»»åŠ¡ï¼šçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° + 1
    private static final int CPU_COUNT = Runtime.getRuntime().availableProcessors();
    
    // IOå¯†é›†å‹ä»»åŠ¡ï¼šçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° * 2
    private static final int IO_THREAD_COUNT = CPU_COUNT * 2;
    
    // è‡ªå®šä¹‰çº¿ç¨‹æ± 
    public static ExecutorService createAsyncExecutor() {
        return new ThreadPoolExecutor(
            IO_THREAD_COUNT,           // æ ¸å¿ƒçº¿ç¨‹æ•°
            IO_THREAD_COUNT * 2,       // æœ€å¤§çº¿ç¨‹æ•°
            60L,                       // çº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´
            TimeUnit.SECONDS,          // æ—¶é—´å•ä½
            new LinkedBlockingQueue<>(1000), // ä»»åŠ¡é˜Ÿåˆ—
            new ThreadFactory() {      // è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚
                private final AtomicInteger threadNumber = new AtomicInteger(1);
                
                @Override
                public Thread newThread(Runnable r) {
                    Thread thread = new Thread(r, "AsyncWorker-" + threadNumber.getAndIncrement());
                    thread.setDaemon(false); // éå®ˆæŠ¤çº¿ç¨‹
                    return thread;
                }
            },
            new ThreadPoolExecutor.CallerRunsPolicy() // æ‹’ç»ç­–ç•¥
        );
    }
}
```

### 6.2 çº¿ç¨‹æ± ç›‘æ§ä¸ç®¡ç†


**ğŸ“ˆ çº¿ç¨‹æ± çŠ¶æ€ç›‘æ§**
```java
@WebServlet(value = "/thread-monitor", asyncSupported = true)
public class ThreadPoolMonitorServlet extends HttpServlet {
    
    private static final ThreadPoolExecutor executor = 
        (ThreadPoolExecutor) AsyncThreadPoolConfig.createAsyncExecutor();
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // è·å–çº¿ç¨‹æ± çŠ¶æ€ä¿¡æ¯
        Map<String, Object> status = new HashMap<>();
        status.put("activeCount", executor.getActiveCount());
        status.put("corePoolSize", executor.getCorePoolSize());
        status.put("maximumPoolSize", executor.getMaximumPoolSize());
        status.put("poolSize", executor.getPoolSize());
        status.put("taskCount", executor.getTaskCount());
        status.put("completedTaskCount", executor.getCompletedTaskCount());
        status.put("queueSize", executor.getQueue().size());
        
        response.setContentType("application/json;charset=UTF-8");
        response.getWriter().write(new Gson().toJson(status));
    }
}
```

**ğŸ¯ ä¼˜åŒ–å»ºè®®**

| **åœºæ™¯** | **æ¨èé…ç½®** | **åŸå› è¯´æ˜** |
|---------|------------|------------|
| **æ–‡ä»¶ä¸Šä¼ ** | `æ ¸å¿ƒçº¿ç¨‹=4ï¼Œæœ€å¤§=8` | `IOæ“ä½œè¾ƒå¤šï¼Œé€‚åº¦å¹¶å‘` |
| **æ•°æ®åº“æŸ¥è¯¢** | `æ ¸å¿ƒçº¿ç¨‹=8ï¼Œæœ€å¤§=16` | `IOç­‰å¾…æ—¶é—´é•¿` |
| **è®¡ç®—ä»»åŠ¡** | `æ ¸å¿ƒçº¿ç¨‹=CPUæ ¸å¿ƒæ•°` | `CPUå¯†é›†ï¼Œé¿å…è¿‡å¤šä¸Šä¸‹æ–‡åˆ‡æ¢` |
| **æ··åˆä»»åŠ¡** | `æ ¸å¿ƒçº¿ç¨‹=CPU*1.5` | `å¹³è¡¡CPUå’ŒIOæ“ä½œ` |

---

## 7. â° è¶…æ—¶å¤„ç†ä¸å¼‚å¸¸ç®¡ç†


### 7.1 è¶…æ—¶æœºåˆ¶è¯¦è§£


**ğŸ• è¶…æ—¶è®¾ç½®ç­–ç•¥**
```java
@WebServlet(value = "/timeout-demo", asyncSupported = true)
public class TimeoutDemoServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        AsyncContext asyncContext = request.startAsync();
        
        // è®¾ç½®è¶…æ—¶æ—¶é—´
        long timeoutMs = Long.parseLong(request.getParameter("timeout"));
        asyncContext.setTimeout(timeoutMs);
        
        // æ·»åŠ è¶…æ—¶ç›‘å¬å™¨
        asyncContext.addListener(new AsyncListener() {
            @Override
            public void onTimeout(AsyncEvent event) throws IOException {
                System.out.println("å¼‚æ­¥è¯·æ±‚è¶…æ—¶ï¼");
                
                HttpServletResponse resp = 
                    (HttpServletResponse) event.getAsyncContext().getResponse();
                
                if (!resp.isCommitted()) { // æ£€æŸ¥å“åº”æ˜¯å¦å·²æäº¤
                    resp.setStatus(408); // è¯·æ±‚è¶…æ—¶
                    resp.setContentType("application/json;charset=UTF-8");
                    resp.getWriter().write(
                        "{\"error\":\"è¯·æ±‚å¤„ç†è¶…æ—¶\",\"code\":408}"
                    );
                }
                
                event.getAsyncContext().complete();
            }
            
            @Override public void onComplete(AsyncEvent event) {
                System.out.println("å¼‚æ­¥å¤„ç†å®Œæˆ");
            }
            
            @Override public void onError(AsyncEvent event) {
                System.out.println("å¼‚æ­¥å¤„ç†å‡ºé”™: " + event.getThrowable().getMessage());
            }
            
            @Override public void onStartAsync(AsyncEvent event) {
                System.out.println("å¼‚æ­¥å¤„ç†å¼€å§‹");
            }
        });
        
        // æ¨¡æ‹Ÿå¯èƒ½è¶…æ—¶çš„ä»»åŠ¡
        CompletableFuture.runAsync(() -> {
            try {
                Thread.sleep(5000); // æ¨¡æ‹Ÿ5ç§’ä»»åŠ¡
                
                HttpServletResponse resp = 
                    (HttpServletResponse) asyncContext.getResponse();
                
                if (!resp.isCommitted()) {
                    resp.getWriter().write("ä»»åŠ¡å®Œæˆï¼Œæœªè¶…æ—¶");
                    asyncContext.complete();
                }
                
            } catch (InterruptedException | IOException e) {
                e.printStackTrace();
            }
        });
    }
}
```

### 7.2 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


**ğŸ›¡ï¸ å®Œæ•´å¼‚å¸¸å¤„ç†æ¡†æ¶**
```java
@WebServlet(value = "/robust-async", asyncSupported = true)
public class RobustAsyncServlet extends HttpServlet {
    
    private static final Logger logger = LoggerFactory.getLogger(RobustAsyncServlet.class);
    
    @Override
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws IOException {
        
        AsyncContext asyncContext = null;
        
        try {
            // å‚æ•°éªŒè¯
            String taskId = request.getParameter("taskId");
            if (taskId == null || taskId.trim().isEmpty()) {
                sendError(response, 400, "ç¼ºå°‘å¿…è¦å‚æ•°taskId");
                return;
            }
            
            // å¯åŠ¨å¼‚æ­¥
            asyncContext = request.startAsync();
            asyncContext.setTimeout(30000); // 30ç§’è¶…æ—¶
            
            // æ·»åŠ å…¨é¢çš„ç›‘å¬å™¨
            final AsyncContext finalAsyncContext = asyncContext;
            asyncContext.addListener(new AsyncListener() {
                @Override
                public void onTimeout(AsyncEvent event) throws IOException {
                    logger.warn("å¼‚æ­¥ä»»åŠ¡è¶…æ—¶ï¼ŒtaskId: {}", taskId);
                    handleTimeout(finalAsyncContext, taskId);
                }
                
                @Override
                public void onError(AsyncEvent event) throws IOException {
                    logger.error("å¼‚æ­¥ä»»åŠ¡å¼‚å¸¸ï¼ŒtaskId: {}", taskId, event.getThrowable());
                    handleError(finalAsyncContext, event.getThrowable());
                }
                
                @Override
                public void onComplete(AsyncEvent event) throws IOException {
                    logger.info("å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼ŒtaskId: {}", taskId);
                }
                
                @Override
                public void onStartAsync(AsyncEvent event) throws IOException {
                    logger.info("å¼‚æ­¥ä»»åŠ¡å¼€å§‹ï¼ŒtaskId: {}", taskId);
                }
            });
            
            // æäº¤å¼‚æ­¥ä»»åŠ¡
            processAsyncTask(asyncContext, taskId);
            
        } catch (Exception e) {
            logger.error("å¯åŠ¨å¼‚æ­¥ä»»åŠ¡å¤±è´¥", e);
            if (asyncContext != null && !asyncContext.getResponse().isCommitted()) {
                handleError(asyncContext, e);
            } else {
                sendError(response, 500, "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯");
            }
        }
    }
    
    private void processAsyncTask(AsyncContext asyncContext, String taskId) {
        CompletableFuture.runAsync(() -> {
            try {
                // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
                String result = performBusinessLogic(taskId);
                
                // æˆåŠŸå“åº”
                sendSuccess(asyncContext, result);
                
            } catch (BusinessException e) {
                logger.warn("ä¸šåŠ¡é€»è¾‘å¼‚å¸¸ï¼ŒtaskId: {}", taskId, e);
                sendBusinessError(asyncContext, e.getMessage());
                
            } catch (Exception e) {
                logger.error("å¤„ç†å¼‚æ­¥ä»»åŠ¡æ—¶å‘ç”Ÿæ„å¤–é”™è¯¯ï¼ŒtaskId: {}", taskId, e);
                handleError(asyncContext, e);
            }
        }).exceptionally(throwable -> {
            logger.error("å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ï¼ŒtaskId: {}", taskId, throwable);
            handleError(asyncContext, throwable);
            return null;
        });
    }
    
    private void handleTimeout(AsyncContext context, String taskId) {
        try {
            if (!context.getResponse().isCommitted()) {
                HttpServletResponse response = (HttpServletResponse) context.getResponse();
                response.setStatus(408);
                response.setContentType("application/json;charset=UTF-8");
                response.getWriter().write(
                    String.format("{\"error\":\"ä»»åŠ¡å¤„ç†è¶…æ—¶\",\"taskId\":\"%s\"}", taskId)
                );
                context.complete();
            }
        } catch (IOException e) {
            logger.error("å¤„ç†è¶…æ—¶å“åº”æ—¶å‘ç”Ÿé”™è¯¯", e);
        }
    }
    
    private void handleError(AsyncContext context, Throwable throwable) {
        try {
            if (!context.getResponse().isCommitted()) {
                HttpServletResponse response = (HttpServletResponse) context.getResponse();
                response.setStatus(500);
                response.setContentType("application/json;charset=UTF-8");
                response.getWriter().write(
                    "{\"error\":\"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\",\"message\":\"" + throwable.getMessage() + "\"}"
                );
                context.complete();
            }
        } catch (IOException e) {
            logger.error("å¤„ç†é”™è¯¯å“åº”æ—¶å‘ç”Ÿé”™è¯¯", e);
        }
    }
    
    // è¾…åŠ©æ–¹æ³•
    private void sendError(HttpServletResponse response, int status, String message) 
            throws IOException {
        response.setStatus(status);
        response.setContentType("application/json;charset=UTF-8");
        response.getWriter().write(
            "{\"error\":\"" + message + "\",\"code\":" + status + "}"
        );
    }
    
    private void sendSuccess(AsyncContext context, String result) {
        // å®ç°æˆåŠŸå“åº”é€»è¾‘
    }
    
    private void sendBusinessError(AsyncContext context, String message) {
        // å®ç°ä¸šåŠ¡é”™è¯¯å“åº”é€»è¾‘  
    }
    
    private String performBusinessLogic(String taskId) throws BusinessException {
        // å®ç°å…·ä½“ä¸šåŠ¡é€»è¾‘
        return "å¤„ç†ç»“æœ";
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> ğŸ§  **è®°å¿†å£è¯€**  
> å¼‚æ­¥å¤„ç†é‡Šæ”¾çº¿ç¨‹ï¼ŒContextä¸Šä¸‹æ–‡ä¿çŠ¶æ€  
> startAsyncå¯åŠ¨å¼‚æ­¥ï¼Œcompleteå®Œæˆè¦ç‰¢è®°  
> è¶…æ—¶ç›‘å¬é˜²æ­»é”ï¼Œå¼‚å¸¸å¤„ç†ä¿ç¨³å®š

**ğŸ”¸ æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹**
- **AsyncContext**ï¼šå¼‚æ­¥ä¸Šä¸‹æ–‡ï¼Œè¿æ¥åŸå§‹çº¿ç¨‹å’Œå¼‚æ­¥çº¿ç¨‹çš„æ¡¥æ¢
- **asyncSupported=true**ï¼šå¯ç”¨å¼‚æ­¥æ”¯æŒçš„å¿…è¦é…ç½®
- **startAsync()**ï¼šåˆ›å»ºå¼‚æ­¥ä¸Šä¸‹æ–‡ï¼Œé‡Šæ”¾åŸå§‹çº¿ç¨‹
- **complete()**ï¼šå®Œæˆå¼‚æ­¥å¤„ç†ï¼Œå‘é€å“åº”ç»™å®¢æˆ·ç«¯
- **çº¿ç¨‹æ± ç®¡ç†**ï¼šåˆç†é…ç½®å¼‚æ­¥å¤„ç†çš„çº¿ç¨‹èµ„æº
- **è¶…æ—¶å¤„ç†**ï¼šé˜²æ­¢å¼‚æ­¥ä»»åŠ¡æ— é™ç­‰å¾…çš„ä¿æŠ¤æœºåˆ¶

### 8.2 å®é™…åº”ç”¨ä»·å€¼ç†è§£


**ğŸ“Š æ€§èƒ½æå‡å¯¹æ¯”**

```
ä¼ ç»ŸåŒæ­¥å¤„ç†ï¼š
100ä¸ªå¹¶å‘è¯·æ±‚ï¼Œæ¯ä¸ªå¤„ç†5ç§’
éœ€è¦ï¼š100ä¸ªçº¿ç¨‹ Ã— 5ç§’ = 500ä¸ªçº¿ç¨‹Â·ç§’
çº¿ç¨‹æ± å¤§å°é™åˆ¶ï¼šæœ€å¤š20ä¸ªçº¿ç¨‹
å®é™…å¤„ç†æ—¶é—´ï¼š100Ã·20Ã—5 = 25ç§’

å¼‚æ­¥å¤„ç†ï¼š
100ä¸ªå¹¶å‘è¯·æ±‚ï¼Œæ¯ä¸ªå¤„ç†5ç§’  
éœ€è¦ï¼š100ä¸ªè¯·æ±‚æ¥æ”¶çº¿ç¨‹(ç¬é—´é‡Šæ”¾) + 20ä¸ªå¤„ç†çº¿ç¨‹
å®é™…å¤„ç†æ—¶é—´ï¼š100Ã·20Ã—5 = 25ç§’
ä½†å¯ä»¥åŒæ—¶æ¥æ”¶æ›´å¤šæ–°è¯·æ±‚ï¼
```

### 8.3 æœ€ä½³å®è·µæŒ‡å¯¼


**âœ… æ¨èåšæ³•**
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢èµ„æºæ³„æ¼
- ä½¿ç”¨ä¸“é—¨çš„çº¿ç¨‹æ± å¤„ç†å¼‚æ­¥ä»»åŠ¡
- å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œç›‘å¬å™¨é…ç½®
- ä¸šåŠ¡é€»è¾‘ä¸å¼‚æ­¥æœºåˆ¶åˆ†ç¦»ï¼Œä¾¿äºæµ‹è¯•

**âŒ å¸¸è§è¯¯åŒº**
- å¿˜è®°è°ƒç”¨`complete()`å¯¼è‡´è¿æ¥ä¸€ç›´å ç”¨
- åœ¨åŸå§‹çº¿ç¨‹ä¸­å†™å“åº”ï¼Œå¼‚æ­¥æ•ˆæœå¤±æ•ˆ
- æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
- å¼‚å¸¸å¤„ç†ä¸å®Œå–„ï¼Œç”¨æˆ·å¾—ä¸åˆ°æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯

### 8.4 å­¦ä¹ å»ºè®®


**ğŸ¯ å¾ªåºæ¸è¿›çš„å­¦ä¹ è·¯å¾„**

1ï¸âƒ£ **åŸºç¡€ç†è§£**ï¼šå…ˆæŒæ¡åŒæ­¥Servletï¼Œç†è§£çº¿ç¨‹æ¨¡å‹  
2ï¸âƒ£ **æ¦‚å¿µå­¦ä¹ **ï¼šç†è§£AsyncContextå’Œå¼‚æ­¥å¤„ç†æµç¨‹  
3ï¸âƒ£ **ç®€å•å®è·µ**ï¼šå®ç°åŸºæœ¬çš„å¼‚æ­¥å“åº”  
4ï¸âƒ£ **è¿›é˜¶åº”ç”¨**ï¼šæ·»åŠ è¶…æ—¶å¤„ç†å’Œå¼‚å¸¸ç®¡ç†  
5ï¸âƒ£ **ç”Ÿäº§ä¼˜åŒ–**ï¼šçº¿ç¨‹æ± é…ç½®å’Œæ€§èƒ½ç›‘æ§

**ğŸ’¡ è°ƒè¯•æŠ€å·§**
- ä½¿ç”¨æ—¥å¿—è®°å½•å¼‚æ­¥å¤„ç†çš„å„ä¸ªé˜¶æ®µ
- ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€ï¼Œè§‚å¯Ÿçº¿ç¨‹ä½¿ç”¨æƒ…å†µ  
- æ¨¡æ‹Ÿè¶…æ—¶å’Œå¼‚å¸¸æƒ…å†µï¼ŒéªŒè¯å¤„ç†é€»è¾‘
- å‹åŠ›æµ‹è¯•éªŒè¯å¹¶å‘å¤„ç†èƒ½åŠ›æå‡

**æ ¸å¿ƒè®°å¿†**ï¼š
- Servletå¼‚æ­¥å¤„ç†é€šè¿‡é‡Šæ”¾è¯·æ±‚çº¿ç¨‹æå‡å¹¶å‘èƒ½åŠ›
- AsyncContextæ˜¯å¼‚æ­¥å¤„ç†çš„æ ¸å¿ƒï¼Œä¿å­˜è¯·æ±‚çŠ¶æ€
- åˆç†çš„çº¿ç¨‹æ± é…ç½®å’Œå¼‚å¸¸å¤„ç†æ˜¯ç”Ÿäº§åº”ç”¨çš„å…³é”®
- å¼‚æ­¥å¤„ç†ç‰¹åˆ«é€‚åˆIOå¯†é›†å‹å’Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡