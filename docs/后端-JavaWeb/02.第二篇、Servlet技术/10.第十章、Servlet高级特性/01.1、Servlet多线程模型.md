---
title: 1ã€Servletå¤šçº¿ç¨‹æ¨¡å‹
---
## ğŸ“š ç›®å½•

1. [Servletå¤šçº¿ç¨‹åŸºç¡€æ¦‚å¿µ](#1-servletå¤šçº¿ç¨‹åŸºç¡€æ¦‚å¿µ)
2. [å•å®ä¾‹å¤šçº¿ç¨‹æ¨¡å‹è¯¦è§£](#2-å•å®ä¾‹å¤šçº¿ç¨‹æ¨¡å‹è¯¦è§£)
3. [çº¿ç¨‹å®‰å…¨é—®é¢˜æ·±å…¥åˆ†æ](#3-çº¿ç¨‹å®‰å…¨é—®é¢˜æ·±å…¥åˆ†æ)
4. [å®ä¾‹å˜é‡å…±äº«é£é™©](#4-å®ä¾‹å˜é‡å…±äº«é£é™©)
5. [åŒæ­¥å¤„ç†æœºåˆ¶](#5-åŒæ­¥å¤„ç†æœºåˆ¶)
6. [ThreadLocalçš„ä½¿ç”¨](#6-threadlocalçš„ä½¿ç”¨)
7. [å¹¶å‘è®¿é—®æ§åˆ¶ç­–ç•¥](#7-å¹¶å‘è®¿é—®æ§åˆ¶ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ§µ Servletå¤šçº¿ç¨‹åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Servletå¤šçº¿ç¨‹æ¨¡å‹


**ğŸ” ç®€å•ç†è§£**
æƒ³è±¡ä¸€ä¸ªé“¶è¡Œåªæœ‰ä¸€ä¸ªæŸœå°ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šé¡¾å®¢è¦åŠä¸šåŠ¡ã€‚ä¼ ç»Ÿåšæ³•æ˜¯è®©é¡¾å®¢æ’é˜Ÿï¼Œä¸€ä¸ªä¸€ä¸ªåŠç†ã€‚ä½†Servleté‡‡ç”¨äº†æ›´èªæ˜çš„æ–¹å¼ï¼š**ä¸€ä¸ªæŸœå°å‘˜å·¥ï¼ˆServletå®ä¾‹ï¼‰åŒæ—¶ä¸ºå¤šä¸ªé¡¾å®¢ï¼ˆè¯·æ±‚ï¼‰æä¾›æœåŠ¡**ã€‚

**ğŸ“‹ æ ¸å¿ƒå®šä¹‰**
```
Servletå¤šçº¿ç¨‹æ¨¡å‹ï¼š
â€¢ ä¸€ä¸ªServletç±»åªåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡
â€¢ å¤šä¸ªç”¨æˆ·è¯·æ±‚å…±äº«è¿™ä¸€ä¸ªå®ä¾‹
â€¢ æ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹
â€¢ æ‰€æœ‰çº¿ç¨‹åŒæ—¶è°ƒç”¨åŒä¸€ä¸ªServletå®ä¾‹çš„service()æ–¹æ³•
```

**ğŸ—ï¸ æ¶æ„å›¾ç¤º**
```
Webå®¹å™¨ï¼ˆå¦‚Tomcatï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Servletå®ä¾‹ï¼ˆåªæœ‰1ä¸ªï¼‰              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    MyServletå®ä¾‹                â”‚ â”‚
â”‚  â”‚                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â†‘    â†‘    â†‘    â†‘           â”‚
â”‚         çº¿ç¨‹1  çº¿ç¨‹2  çº¿ç¨‹3  çº¿ç¨‹4     â”‚
â”‚           â”‚    â”‚    â”‚    â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚    â”‚    â”‚    â”‚
          è¯·æ±‚A  è¯·æ±‚B  è¯·æ±‚C  è¯·æ±‚D
```

### 1.2 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹


**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
å°±åƒä¸€ä¸ªç»éªŒä¸°å¯Œçš„åŒ»ç”Ÿï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªç—…äººå•ç‹¬åŸ¹è®­ä¸€ä¸ªåŒ»ç”Ÿï¼Œè€Œæ˜¯è®©è¿™ä¸ªåŒ»ç”ŸåŒæ—¶å¤„ç†å¤šä¸ªç—…äººçš„å’¨è¯¢ã€‚è¿™æ ·æ—¢èŠ‚çº¦äº†èµ„æºï¼Œåˆæé«˜äº†æ•ˆç‡ã€‚

**âœ… å¤šçº¿ç¨‹æ¨¡å‹çš„ä¼˜åŠ¿**
- **ğŸš€ æ€§èƒ½é«˜æ•ˆ**ï¼šé¿å…é‡å¤åˆ›å»ºå¯¹è±¡çš„å¼€é”€
- **ğŸ’¾ å†…å­˜èŠ‚çœ**ï¼šåªéœ€è¦ä¸€ä¸ªå®ä¾‹å¯¹è±¡
- **âš¡ å“åº”å¿«é€Ÿ**ï¼šå¤šä¸ªè¯·æ±‚å¹¶å‘å¤„ç†
- **ğŸ”§ èµ„æºä¼˜åŒ–**ï¼šæœ€å¤§åŒ–åˆ©ç”¨æœåŠ¡å™¨èµ„æº

**ğŸ“Š æ€§èƒ½å¯¹æ¯”**
| æ¨¡å‹ç±»å‹ | å†…å­˜å ç”¨ | å¤„ç†é€Ÿåº¦ | èµ„æºåˆ©ç”¨ç‡ |
|---------|---------|----------|-----------|
| **å•çº¿ç¨‹å•å®ä¾‹** | ğŸŸ¢ å¾ˆä½ | ğŸ”´ å¾ˆæ…¢ | ğŸ”´ å¾ˆä½ |
| **å¤šå®ä¾‹æ¨¡å‹** | ğŸ”´ å¾ˆé«˜ | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¡ ä¸­ç­‰ |
| **å¤šçº¿ç¨‹å•å®ä¾‹** | ğŸŸ¢ ä½ | ğŸŸ¢ å¿« | ğŸŸ¢ é«˜ |

---

## 2. ğŸ¢ å•å®ä¾‹å¤šçº¿ç¨‹æ¨¡å‹è¯¦è§£


### 2.1 Servletå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸ


**ğŸ“… å®ä¾‹åˆ›å»ºæ—¶æœº**
```
Servletå®ä¾‹ä½•æ—¶åˆ›å»ºï¼Ÿ

æƒ…å†µ1ï¼šé¦–æ¬¡è¯·æ±‚æ—¶åˆ›å»ºï¼ˆé»˜è®¤ï¼‰
ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—® â†’ å®¹å™¨æ£€æŸ¥æ˜¯å¦æœ‰å®ä¾‹ â†’ æ²¡æœ‰åˆ™åˆ›å»º â†’ è°ƒç”¨init()

æƒ…å†µ2ï¼šå®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºï¼ˆé…ç½®ï¼‰
å®¹å™¨å¯åŠ¨ â†’ è¯»å–é…ç½® â†’ ç«‹å³åˆ›å»ºå®ä¾‹ â†’ è°ƒç”¨init()
```

**ğŸ”„ ç”Ÿå‘½å‘¨æœŸæµç¨‹**
```
Servletç”Ÿå‘½å‘¨æœŸå®Œæ•´æµç¨‹ï¼š

1. ç±»åŠ è½½é˜¶æ®µ
   â””â”€â”€ JVMåŠ è½½Servletç±»

2. å®ä¾‹åŒ–é˜¶æ®µï¼ˆåªæ‰§è¡Œ1æ¬¡ï¼‰
   â””â”€â”€ new MyServlet()
   â””â”€â”€ è°ƒç”¨init()æ–¹æ³•

3. æœåŠ¡é˜¶æ®µï¼ˆæ‰§è¡ŒNæ¬¡ï¼‰
   â”œâ”€â”€ è¯·æ±‚1 â†’ çº¿ç¨‹1è°ƒç”¨service()
   â”œâ”€â”€ è¯·æ±‚2 â†’ çº¿ç¨‹2è°ƒç”¨service()  
   â”œâ”€â”€ è¯·æ±‚3 â†’ çº¿ç¨‹3è°ƒç”¨service()
   â””â”€â”€ ... ï¼ˆåŒæ—¶è¿›è¡Œï¼‰

4. é”€æ¯é˜¶æ®µï¼ˆåªæ‰§è¡Œ1æ¬¡ï¼‰
   â””â”€â”€ å®¹å™¨å…³é—­æ—¶è°ƒç”¨destroy()
```

### 2.2 å¤šçº¿ç¨‹è°ƒç”¨æœºåˆ¶


**ğŸ¯ æ ¸å¿ƒæœºåˆ¶**
æ¯å½“æœ‰æ–°çš„HTTPè¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒWebå®¹å™¨ä¼šï¼š

1. **æ£€æŸ¥Servletå®ä¾‹**ï¼šæ˜¯å¦å·²ç»å­˜åœ¨
2. **åˆ›å»ºå·¥ä½œçº¿ç¨‹**ï¼šä¸ºè¿™ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹
3. **è°ƒç”¨serviceæ–¹æ³•**ï¼šçº¿ç¨‹æ‰§è¡Œservletçš„service()æ–¹æ³•
4. **è¿”å›å“åº”**ï¼šå¤„ç†å®Œæˆåè¿”å›ç»“æœç»™å®¢æˆ·ç«¯
5. **å›æ”¶çº¿ç¨‹**ï¼šçº¿ç¨‹å›åˆ°çº¿ç¨‹æ± å¾…å‘½

**ğŸ”§ å®é™…è¿è¡Œç¤ºä¾‹**
```java
// è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Servletç¤ºä¾‹
public class CounterServlet extends HttpServlet {
    private int count = 0; // âš ï¸ æ³¨æ„ï¼šè¿™æ˜¯å®ä¾‹å˜é‡
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // å‡è®¾æœ‰3ä¸ªç”¨æˆ·åŒæ—¶è®¿é—®
        count++; // æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæ‰§è¡Œè¿™è¡Œä»£ç 
        
        response.getWriter().println("è®¿é—®æ¬¡æ•°: " + count);
    }
}
```

**ğŸ“ˆ å¹¶å‘æ‰§è¡Œç¤ºæ„**
```
æ—¶é—´çº¿ï¼š0ç§’    1ç§’    2ç§’    3ç§’
        â”‚      â”‚      â”‚      â”‚
çº¿ç¨‹1   â”‚â”€â”€â”€â”€â”€startâ”€â”€â”€â”€â”€â”€end
çº¿ç¨‹2   â”‚â”€â”€â”€â”€â”€â”€â”€â”€startâ”€â”€â”€â”€end  
çº¿ç¨‹3   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€startâ”€â”€end

è¯´æ˜ï¼šä¸‰ä¸ªçº¿ç¨‹å‡ ä¹åŒæ—¶å¼€å§‹æ‰§è¡ŒdoGet()æ–¹æ³•
éƒ½åœ¨æ“ä½œåŒä¸€ä¸ªcountå˜é‡ï¼
```

### 2.3 å•å®ä¾‹å¤šçº¿ç¨‹çš„å†…å­˜æ¨¡å‹


**ğŸ§  å†…å­˜å¸ƒå±€ç†è§£**
```
JVMå†…å­˜ç»“æ„ï¼š

å †å†…å­˜ï¼ˆHeapï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Servletå®ä¾‹å¯¹è±¡         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ count = ?           â”‚ â”‚ â† å®ä¾‹å˜é‡ï¼ˆå…±äº«ï¼‰
â”‚  â”‚ å…¶ä»–å®ä¾‹å˜é‡...      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çº¿ç¨‹æ ˆï¼ˆStackï¼‰
â”Œâ”€â”€çº¿ç¨‹1æ ˆâ”€â”€â” â”Œâ”€â”€çº¿ç¨‹2æ ˆâ”€â”€â” â”Œâ”€â”€çº¿ç¨‹3æ ˆâ”€â”€â”
â”‚ å±€éƒ¨å˜é‡  â”‚ â”‚ å±€éƒ¨å˜é‡  â”‚ â”‚ å±€éƒ¨å˜é‡  â”‚
â”‚ æ–¹æ³•å‚æ•°  â”‚ â”‚ æ–¹æ³•å‚æ•°  â”‚ â”‚ æ–¹æ³•å‚æ•°  â”‚
â”‚ ...      â”‚ â”‚ ...      â”‚ â”‚ ...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å…³é”®ç†è§£**
- **å †å†…å­˜ä¸­çš„å®ä¾‹å˜é‡**ï¼šæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œè¿™é‡Œå®¹æ˜“å‡ºé—®é¢˜ï¼
- **æ ˆå†…å­˜ä¸­çš„å±€éƒ¨å˜é‡**ï¼šæ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰ï¼Œç›¸å¯¹å®‰å…¨

---

## 3. âš ï¸ çº¿ç¨‹å®‰å…¨é—®é¢˜æ·±å…¥åˆ†æ


### 3.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜


**ğŸ¤” ç”Ÿæ´»ç±»æ¯”**
æƒ³è±¡é“¶è¡Œè´¦æˆ·æœ‰1000å…ƒï¼Œä½ å’Œä½ çš„é…å¶åŒæ—¶åœ¨ä¸åŒçš„ATMæœºå–é’±ï¼Œéƒ½æƒ³å–500å…ƒã€‚å¦‚æœä¸¤å°ATMåŒæ—¶è¯»åˆ°è´¦æˆ·ä½™é¢æ˜¯1000å…ƒï¼Œéƒ½è®¤ä¸ºå¯ä»¥å–500å…ƒï¼Œç»“æœä¸¤ç¬”äº¤æ˜“éƒ½æˆåŠŸäº†ï¼Œè´¦æˆ·å°±å˜æˆäº†-500å…ƒï¼è¿™å°±æ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

**ğŸ“‹ çº¿ç¨‹å®‰å…¨é—®é¢˜å®šä¹‰**
```
çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š
å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œ
ç”±äºæ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œ
å¯¼è‡´ç¨‹åºè¿è¡Œç»“æœä¸é¢„æœŸä¸ç¬¦çš„é—®é¢˜
```

### 3.2 çº¿ç¨‹ä¸å®‰å…¨çš„å…¸å‹åœºæ™¯


**ğŸ” é—®é¢˜ä»£ç ç¤ºä¾‹**
```java
public class UnsafeServlet extends HttpServlet {
    private int counter = 0; // å…±äº«å˜é‡
    private List<String> userList = new ArrayList<>(); // éçº¿ç¨‹å®‰å…¨é›†åˆ
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // åœºæ™¯1: è®¡æ•°å™¨é—®é¢˜
        counter++; // è¿™è¡Œä»£ç ä¸æ˜¯åŸå­æ“ä½œï¼
        
        // åœºæ™¯2: é›†åˆæ“ä½œé—®é¢˜
        String username = request.getParameter("username");
        userList.add(username); // ArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼
        
        // åœºæ™¯3: æ¡ä»¶åˆ¤æ–­é—®é¢˜
        if (counter > 100) {
            counter = 0; // åœ¨åˆ¤æ–­å’Œé‡ç½®ä¹‹é—´å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹
        }
        
        response.getWriter().println("å½“å‰è®¡æ•°: " + counter);
    }
}
```

**âš¡ çº¿ç¨‹ç«äº‰è¯¦ç»†åˆ†æ**
```
counter++ è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„æ“ä½œå®é™…åŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼š

æ­¥éª¤1: è¯»å–counterçš„å€¼åˆ°ä¸´æ—¶å˜é‡  (temp = counter)
æ­¥éª¤2: ä¸´æ—¶å˜é‡åŠ 1                (temp = temp + 1) 
æ­¥éª¤3: å°†ç»“æœå†™å›counter          (counter = temp)

å¹¶å‘æ‰§è¡Œå¯èƒ½çš„æƒ…å†µï¼š
çº¿ç¨‹A: è¯»å–(0) â†’ åŠ 1(1) â†’ 
çº¿ç¨‹B:       è¯»å–(0) â†’ åŠ 1(1) â†’ å†™å…¥(1)
çº¿ç¨‹A:                      â†’ å†™å…¥(1)

ç»“æœï¼šä¸¤æ¬¡æ“ä½œåï¼Œcounter = 1 è€Œä¸æ˜¯ 2ï¼
```

### 3.3 çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å±å®³


**âš ï¸ å¸¸è§é—®é¢˜ç±»å‹**

| é—®é¢˜ç±»å‹ | å…·ä½“è¡¨ç° | åæœä¸¥é‡ç¨‹åº¦ |
|---------|---------|-------------|
| **æ•°æ®ä¸¢å¤±** | å¤šä¸ªæ“ä½œäº’ç›¸è¦†ç›– | ğŸ”´ ä¸¥é‡ |
| **æ•°æ®ä¸ä¸€è‡´** | è¯»å–åˆ°ä¸­é—´çŠ¶æ€ | ğŸ”´ ä¸¥é‡ |
| **ç©ºæŒ‡é’ˆå¼‚å¸¸** | å¯¹è±¡è¢«æ„å¤–é‡ç½® | ğŸŸ¡ ä¸­ç­‰ |
| **é›†åˆå¼‚å¸¸** | ConcurrentModificationException | ğŸŸ¡ ä¸­ç­‰ |
| **é€»è¾‘é”™è¯¯** | ä¸šåŠ¡æµç¨‹è¢«æ‰“ä¹± | ğŸ”´ ä¸¥é‡ |

**ğŸ“Š é—®é¢˜å‘ç”Ÿæ¦‚ç‡**
```
å¹¶å‘è®¿é—®é‡ä¸é—®é¢˜å‘ç”Ÿç‡ï¼š

ä½å¹¶å‘ï¼ˆ<10ç”¨æˆ·ï¼‰ï¼šå¾ˆå°‘å‡ºç°é—®é¢˜ï¼Œå®¹æ˜“è¢«å¿½è§†
ä¸­å¹¶å‘ï¼ˆ10-100ç”¨æˆ·ï¼‰ï¼šå¶å°”å‡ºç°é—®é¢˜ï¼Œéš¾ä»¥é‡ç°
é«˜å¹¶å‘ï¼ˆ>100ç”¨æˆ·ï¼‰ï¼šé¢‘ç¹å‡ºç°é—®é¢˜ï¼Œç³»ç»Ÿä¸ç¨³å®š

âš ï¸ å±é™©çš„æ˜¯ï¼šå¼€å‘æµ‹è¯•é˜¶æ®µå¾€å¾€æ˜¯ä½å¹¶å‘ï¼Œ
   é—®é¢˜åœ¨ç”Ÿäº§ç¯å¢ƒçš„é«˜å¹¶å‘ä¸‹æ‰æš´éœ²ï¼
```

---

## 4. ğŸš¨ å®ä¾‹å˜é‡å…±äº«é£é™©


### 4.1 å®ä¾‹å˜é‡ vs å±€éƒ¨å˜é‡


**ğŸ¯ å…³é”®åŒºåˆ«ç†è§£**
```java
public class VariableServlet extends HttpServlet {
    // å®ä¾‹å˜é‡ - åœ¨ç±»çº§åˆ«å®šä¹‰ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«
    private String sharedMessage = ""; // âš ï¸ å±é™©åŒºåŸŸ
    private int requestCount = 0;       // âš ï¸ å±é™©åŒºåŸŸ
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // å±€éƒ¨å˜é‡ - åœ¨æ–¹æ³•å†…å®šä¹‰ï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰
        String localMessage = "";      // âœ… å®‰å…¨
        int localCount = 0;             // âœ… å®‰å…¨
        
        // å‚æ•°å˜é‡ - æ–¹æ³•å‚æ•°ï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰
        // request, response ä¹Ÿæ˜¯å®‰å…¨çš„   // âœ… å®‰å…¨
    }
}
```

**ğŸ§  å†…å­˜åˆ†é…å¯¹æ¯”**
```
å®ä¾‹å˜é‡ï¼ˆå…±äº«ï¼Œå±é™©ï¼‰ï¼š
å †å†…å­˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Servletå®ä¾‹         â”‚
â”‚  sharedMessage â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½è®¿é—®å’Œä¿®æ”¹
â”‚  requestCount â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½è®¿é—®å’Œä¿®æ”¹  
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å±€éƒ¨å˜é‡ï¼ˆç‹¬ç«‹ï¼Œå®‰å…¨ï¼‰ï¼š
çº¿ç¨‹1æ ˆ        çº¿ç¨‹2æ ˆ        çº¿ç¨‹3æ ˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚localMessageâ”‚  â”‚localMessageâ”‚  â”‚localMessageâ”‚
â”‚localCount  â”‚  â”‚localCount  â”‚  â”‚localCount  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å®ä¾‹å˜é‡çš„é£é™©åœºæ™¯


**ğŸ’¥ åœºæ™¯1ï¼šç”¨æˆ·ä¿¡æ¯æ··ä¹±**
```java
public class UserServlet extends HttpServlet {
    private String currentUser; // å­˜å‚¨å½“å‰ç”¨æˆ· - å±é™©ï¼
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        currentUser = request.getParameter("username");
        
        // æ¨¡æ‹Ÿä¸€äº›å¤„ç†æ—¶é—´
        try {
            Thread.sleep(100); // åœ¨è¿™æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½ä¿®æ”¹currentUserï¼
        } catch (InterruptedException e) {}
        
        // è¿™é‡Œçš„currentUserå¯èƒ½å·²ç»ä¸æ˜¯åŸæ¥çš„ç”¨æˆ·äº†ï¼
        response.getWriter().println("Hello, " + currentUser);
    }
}
```

**âš¡ å¹¶å‘æ‰§è¡Œé—®é¢˜**
```
æ—¶é—´è½´æ¼”ç¤ºï¼š

T0: ç”¨æˆ·Aè¯·æ±‚ â†’ currentUser = "Alice"
T1: ç”¨æˆ·Bè¯·æ±‚ â†’ currentUser = "Bob"    (è¦†ç›–äº†Alice)
T2: ç”¨æˆ·Açš„å¤„ç†å®Œæˆ â†’ è¾“å‡º "Hello, Bob" (é”™è¯¯ï¼)
T3: ç”¨æˆ·Bçš„å¤„ç†å®Œæˆ â†’ è¾“å‡º "Hello, Bob" (æ­£ç¡®)

ç»“æœï¼šç”¨æˆ·Aliceçœ‹åˆ°äº†é”™è¯¯çš„æ¬¢è¿ä¿¡æ¯ï¼
```

**ğŸ’¥ åœºæ™¯2ï¼šè®¡æ•°å™¨ä¸å‡†ç¡®**
```java
public class VisitorServlet extends HttpServlet {
    private int totalVisitors = 0;
    private int todayVisitors = 0;
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // è¿™äº›æ“ä½œéƒ½ä¸æ˜¯åŸå­çš„ï¼
        totalVisitors++;    // å¯èƒ½ä¸¢å¤±è®¡æ•°
        todayVisitors++;    // å¯èƒ½ä¸¢å¤±è®¡æ•°
        
        // å¤åˆæ“ä½œæ›´å±é™©
        if (todayVisitors > 1000) {
            todayVisitors = 0; // é‡ç½®è®¡æ•°ï¼Œä½†åˆ¤æ–­å’Œé‡ç½®ä¹‹é—´å¯èƒ½è¢«ä¿®æ”¹
        }
        
        response.getWriter().println(
            "æ€»è®¿é—®é‡: " + totalVisitors + 
            ", ä»Šæ—¥è®¿é—®: " + todayVisitors);
    }
}
```

### 4.3 è¯†åˆ«å…±äº«é£é™©çš„æ–¹æ³•


**ğŸ” é£é™©è¯†åˆ«æ£€æŸ¥æ¸…å•**

- [ ] **å®ä¾‹å˜é‡æ£€æŸ¥**ï¼šç±»ä¸­æ˜¯å¦å®šä¹‰äº†å®ä¾‹å˜é‡ï¼Ÿ
- [ ] **è¯»å†™æ“ä½œ**ï¼šæ˜¯å¦å¯¹å®ä¾‹å˜é‡è¿›è¡Œè¯»å†™ï¼Ÿ
- [ ] **å¤åˆæ“ä½œ**ï¼šæ˜¯å¦æœ‰"è¯»å–-ä¿®æ”¹-å†™å…¥"çš„ç»„åˆæ“ä½œï¼Ÿ
- [ ] **æ¡ä»¶åˆ¤æ–­**ï¼šæ˜¯å¦åŸºäºå®ä¾‹å˜é‡è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Ÿ
- [ ] **é›†åˆæ“ä½œ**ï¼šæ˜¯å¦ä½¿ç”¨äº†éçº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Ÿ

**âœ… å®‰å…¨ç¼–ç¨‹åŸåˆ™**
```
1. ä¼˜å…ˆä½¿ç”¨å±€éƒ¨å˜é‡
   â”œâ”€â”€ åœ¨æ–¹æ³•å†…å®šä¹‰å˜é‡
   â””â”€â”€ é€šè¿‡å‚æ•°ä¼ é€’æ•°æ®

2. é¿å…å®ä¾‹å˜é‡
   â”œâ”€â”€ å¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œè¦è€ƒè™‘åŒæ­¥
   â””â”€â”€ è€ƒè™‘ä½¿ç”¨ThreadLocal

3. ä½¿ç”¨ä¸å¯å˜å¯¹è±¡
   â”œâ”€â”€ ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹
   â””â”€â”€ å¦‚Stringã€Integerç­‰

4. ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ç±»
   â”œâ”€â”€ ConcurrentHashMapä»£æ›¿HashMap
   â””â”€â”€ Vectorä»£æ›¿ArrayListï¼ˆè™½ç„¶æ€§èƒ½å·®äº›ï¼‰
```

---

## 5. ğŸ”’ åŒæ­¥å¤„ç†æœºåˆ¶


### 5.1 synchronizedå…³é”®å­—è¯¦è§£


**ğŸ”‘ synchronizedçš„æœ¬è´¨**
æƒ³è±¡ä¸€ä¸ªå•æ‰€åªæœ‰ä¸€æŠŠé’¥åŒ™ï¼Œè°æ‹¿åˆ°é’¥åŒ™è°å°±èƒ½è¿›å»ï¼Œå…¶ä»–äººå¿…é¡»åœ¨å¤–é¢ç­‰å¾…ã€‚synchronizedå°±æ˜¯è¿™æŠŠ"é’¥åŒ™"ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œè¢«ä¿æŠ¤çš„ä»£ç ã€‚

**ğŸ“‹ synchronizedçš„ä½¿ç”¨æ–¹å¼**
```java
public class SafeServlet extends HttpServlet {
    private int counter = 0;
    
    // æ–¹å¼1ï¼šåŒæ­¥æ–¹æ³•
    public synchronized void incrementCounter() {
        counter++; // æ•´ä¸ªæ–¹æ³•è¢«é”å®š
    }
    
    // æ–¹å¼2ï¼šåŒæ­¥ä»£ç å—
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        synchronized(this) { // é”å®šå½“å‰å¯¹è±¡
            counter++; // åªæœ‰è¿™éƒ¨åˆ†ä»£ç è¢«é”å®š
            response.getWriter().println("è®¡æ•°: " + counter);
        }
    }
}
```

### 5.2 synchronizedçš„å·¥ä½œåŸç†


**ğŸ”„ åŠ é”è¿‡ç¨‹è¯¦è§£**
```
synchronizedå·¥ä½œæµç¨‹ï¼š

1. çº¿ç¨‹è¯·æ±‚é”
   â””â”€â”€ å°è¯•è·å–å¯¹è±¡çš„ç›‘è§†å™¨é”

2. è·å–é”æˆåŠŸ
   â”œâ”€â”€ è¿›å…¥åŒæ­¥ä»£ç å—
   â””â”€â”€ æ‰§è¡Œä¸šåŠ¡é€»è¾‘

3. é‡Šæ”¾é”
   â”œâ”€â”€ ä»£ç æ‰§è¡Œå®Œæ¯•ï¼ˆæ­£å¸¸æˆ–å¼‚å¸¸ï¼‰
   â””â”€â”€ è‡ªåŠ¨é‡Šæ”¾é”

4. å…¶ä»–çº¿ç¨‹è·å–é”
   â””â”€â”€ ä¹‹å‰ç­‰å¾…çš„çº¿ç¨‹å¼€å§‹ç«äº‰é”
```

**â° æ‰§è¡Œæ—¶åºå›¾**
```
çº¿ç¨‹A: â”€â”€è·å–é”â”€â”€â†’[æ‰§è¡Œä»£ç ]â”€â”€é‡Šæ”¾é”â”€â”€â†’
çº¿ç¨‹B: â”€â”€â”€â”€ç­‰å¾…â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’è·å–é”â”€â”€â†’[æ‰§è¡Œä»£ç ]â”€â”€â†’
çº¿ç¨‹C: â”€â”€â”€â”€ç­‰å¾…â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ç­‰å¾…â”€â”€â”€â”€â†’
```

### 5.3 åŒæ­¥çš„æ€§èƒ½å½±å“


**ğŸ“Š æ€§èƒ½å¯¹æ¯”åˆ†æ**
| åŒæ­¥æ–¹å¼ | æ‰§è¡Œé€Ÿåº¦ | å¹¶å‘èƒ½åŠ› | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|----------|
| **æ— åŒæ­¥** | ğŸŸ¢ æœ€å¿« | ğŸŸ¢ æœ€å¥½ | åªè¯»æ“ä½œ |
| **åŒæ­¥ä»£ç å—** | ğŸŸ¡ è¾ƒå¿« | ğŸŸ¡ ä¸­ç­‰ | å±€éƒ¨ä¿æŠ¤ |
| **åŒæ­¥æ–¹æ³•** | ğŸŸ¡ è¾ƒæ…¢ | ğŸ”´ è¾ƒå·® | æ•´ä½“ä¿æŠ¤ |
| **ç±»çº§åˆ«é”** | ğŸ”´ æœ€æ…¢ | ğŸ”´ æœ€å·® | é™æ€èµ„æº |

**âš ï¸ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```
1. å‡å°é”çš„èŒƒå›´
   âŒ é”æ•´ä¸ªæ–¹æ³•      
   âœ… åªé”å…³é”®ä»£ç æ®µ

2. å‡å°‘é”çš„æ—¶é—´
   âŒ åœ¨é”å†…è¿›è¡ŒIOæ“ä½œ
   âœ… å…ˆå‡†å¤‡æ•°æ®ï¼Œå†åŠ é”æ“ä½œ

3. é¿å…æ­»é”
   âŒ ä¸åŒé¡ºåºè·å–å¤šä¸ªé”
   âœ… ç»Ÿä¸€çš„é”è·å–é¡ºåº
```

### 5.4 åŒæ­¥å®è·µç¤ºä¾‹


**ğŸ›¡ï¸ å®‰å…¨çš„è®¡æ•°å™¨Servlet**
```java
public class SafeCounterServlet extends HttpServlet {
    private int totalCount = 0;
    private final Object lock = new Object(); // ä¸“ç”¨é”å¯¹è±¡
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // å±€éƒ¨å˜é‡ï¼Œçº¿ç¨‹å®‰å…¨
        String username = request.getParameter("username");
        long startTime = System.currentTimeMillis();
        
        // åªå¯¹å…±äº«èµ„æºåŠ é”
        int currentCount;
        synchronized (lock) {
            totalCount++; // åŸå­æ“ä½œ
            currentCount = totalCount; // è·å–å½“å‰å€¼
        } // é”èŒƒå›´å°½é‡å°
        
        // åœ¨é”å¤–è¿›è¡ŒIOæ“ä½œï¼Œæé«˜æ€§èƒ½
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<h2>è®¿é—®ç»Ÿè®¡</h2>");
        out.println("ç”¨æˆ·: " + username + "<br>");
        out.println("æ‚¨æ˜¯ç¬¬ " + currentCount + " ä½è®¿å®¢<br>");
        out.println("è®¿é—®æ—¶é—´: " + new Date());
    }
}
```

**ğŸ’¡ å…³é”®æ”¹è¿›ç‚¹**
- âœ… ä½¿ç”¨ä¸“ç”¨é”å¯¹è±¡è€Œä¸æ˜¯this
- âœ… é”çš„èŒƒå›´æœ€å°åŒ–
- âœ… åœ¨é”å¤–è¿›è¡ŒIOæ“ä½œ
- âœ… å±€éƒ¨å˜é‡å­˜å‚¨é”å†…è·å–çš„å€¼

---

## 6. ğŸ§­ ThreadLocalçš„ä½¿ç”¨


### 6.1 ThreadLocalåŸºæœ¬æ¦‚å¿µ


**ğŸ¯ ThreadLocalçš„æœ¬è´¨**
æƒ³è±¡æ¯ä¸ªå·¥äººéƒ½æœ‰è‡ªå·±çš„å·¥å…·ç®±ï¼Œè™½ç„¶ä»–ä»¬åšåŒæ ·çš„å·¥ä½œï¼Œä½†å„è‡ªä½¿ç”¨è‡ªå·±çš„å·¥å…·ï¼Œäº’ä¸å¹²æ‰°ã€‚ThreadLocalå°±æ˜¯ç»™æ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä¸ª"ç§äººå·¥å…·ç®±"ï¼Œå­˜å‚¨è¯¥çº¿ç¨‹ä¸“ç”¨çš„æ•°æ®ã€‚

**ğŸ“‹ ThreadLocalå®šä¹‰**
```
ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ
â€¢ çº¿ç¨‹å±€éƒ¨å˜é‡çš„å®¹å™¨
â€¢ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´
â€¢ çº¿ç¨‹é—´å½¼æ­¤éš”ç¦»ï¼Œä¸ä¼šç›¸äº’å½±å“
â€¢ è‡ªåŠ¨ç®¡ç†å„çº¿ç¨‹çš„æ•°æ®å‰¯æœ¬
```

### 6.2 ThreadLocalå·¥ä½œåŸç†


**ğŸ§  å†…å­˜æ¨¡å‹å›¾è§£**
```
ThreadLocalå­˜å‚¨æ¨¡å‹ï¼š

ThreadLocalå˜é‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ThreadLocal    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ThreadLocalMap               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Thread-1  â”‚   Thread-2  â”‚   Thread-3  â”‚
â”‚   Value: A  â”‚   Value: B  â”‚   Value: C  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”„ è®¿é—®æµç¨‹**
```
ThreadLocalè®¿é—®è¿‡ç¨‹ï¼š

1. è°ƒç”¨threadLocal.get()
   â””â”€â”€ è·å–å½“å‰çº¿ç¨‹

2. æŸ¥æ‰¾çº¿ç¨‹çš„ThreadLocalMap  
   â””â”€â”€ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„map

3. ä»¥ThreadLocalä¸ºkeyæŸ¥æ‰¾å€¼
   â””â”€â”€ è¿”å›è¯¥çº¿ç¨‹çš„ä¸“å±å€¼

4. å¦‚æœæ²¡æœ‰å€¼åˆ™è°ƒç”¨initialValue()
   â””â”€â”€ åˆ›å»ºåˆå§‹å€¼
```

### 6.3 ThreadLocalå®é™…åº”ç”¨


**ğŸ› ï¸ ç”¨æˆ·ä¿¡æ¯å­˜å‚¨ç¤ºä¾‹**
```java
public class UserContextServlet extends HttpServlet {
    
    // åˆ›å»ºThreadLocalå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
    private static final ThreadLocal<String> userContext = 
        new ThreadLocal<String>() {
            @Override
            protected String initialValue() {
                return "guest"; // é»˜è®¤å€¼
            }
        };
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // è®¾ç½®å½“å‰çº¿ç¨‹çš„ç”¨æˆ·ä¿¡æ¯
        String username = request.getParameter("username");
        if (username != null) {
            userContext.set(username);
        }
        
        // è°ƒç”¨ä¸šåŠ¡æ–¹æ³•
        processUserRequest();
        
        // æ¸…ç†ThreadLocalï¼ˆé‡è¦ï¼ï¼‰
        userContext.remove();
        
        response.getWriter().println("å¤„ç†å®Œæˆ");
    }
    
    private void processUserRequest() {
        // åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        String currentUser = userContext.get();
        System.out.println("å½“å‰å¤„ç†ç”¨æˆ·: " + currentUser);
        
        // è°ƒç”¨å…¶ä»–æ–¹æ³•ä¹Ÿèƒ½è·å–åˆ°
        logUserActivity();
    }
    
    private void logUserActivity() {
        String user = userContext.get(); // è·å–å½“å‰çº¿ç¨‹çš„ç”¨æˆ·
        System.out.println("è®°å½•ç”¨æˆ·æ´»åŠ¨: " + user);
    }
}
```

### 6.4 ThreadLocalçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹


**âœ… ThreadLocalä¼˜åŠ¿**
- **ğŸ”’ çº¿ç¨‹å®‰å…¨**ï¼šæ¯ä¸ªçº¿ç¨‹ç‹¬äº«æ•°æ®ï¼Œå¤©ç„¶çº¿ç¨‹å®‰å…¨
- **ğŸš€ æ— é”è®¿é—®**ï¼šä¸éœ€è¦synchronizedï¼Œæ€§èƒ½æ›´å¥½
- **ğŸ“¦ æ•°æ®éš”ç¦»**ï¼šçº¿ç¨‹é—´æ•°æ®å®Œå…¨éš”ç¦»
- **ğŸ¯ ä¸Šä¸‹æ–‡ä¼ é€’**ï¼šåœ¨è°ƒç”¨é“¾ä¸­æ–¹ä¾¿ä¼ é€’æ•°æ®

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
```
1. å†…å­˜æ³„æ¼é£é™©
   é—®é¢˜ï¼šThreadLocalå¼•ç”¨ä¸æ¸…ç†ä¼šå¯¼è‡´å†…å­˜æ³„æ¼
   è§£å†³ï¼šä½¿ç”¨å®Œæ¯•åè°ƒç”¨remove()

2. çº¿ç¨‹æ± ç¯å¢ƒé—®é¢˜
   é—®é¢˜ï¼šçº¿ç¨‹å¤ç”¨æ—¶å¯èƒ½è·å–åˆ°æ—§æ•°æ®
   è§£å†³ï¼šæ¯æ¬¡ä½¿ç”¨å‰é‡æ–°è®¾ç½®å€¼

3. çˆ¶å­çº¿ç¨‹é—®é¢˜
   é—®é¢˜ï¼šThreadLocalä¸ä¼šè‡ªåŠ¨ä¼ é€’ç»™å­çº¿ç¨‹
   è§£å†³ï¼šä½¿ç”¨InheritableThreadLocal
```

**ğŸ’¡ æœ€ä½³å®è·µæ¨¡å¼**
```java
public class ThreadLocalBestPractice {
    private static final ThreadLocal<UserInfo> USER_CONTEXT = 
        new ThreadLocal<>();
    
    // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
    public static void setUser(UserInfo user) {
        USER_CONTEXT.set(user);
    }
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    public static UserInfo getUser() {
        return USER_CONTEXT.get();
    }
    
    // æ¸…ç†èµ„æºï¼ˆå…³é”®ï¼‰
    public static void clear() {
        USER_CONTEXT.remove();
    }
    
    // åœ¨Filterä¸­ä½¿ç”¨
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        try {
            // è®¾ç½®ç”¨æˆ·ä¸Šä¸‹æ–‡
            UserInfo user = getUserFromRequest(request);
            setUser(user);
            
            // ç»§ç»­å¤„ç†
            chain.doFilter(request, response);
            
        } finally {
            // ç¡®ä¿æ¸…ç†èµ„æº
            clear();
        }
    }
}
```

---

## 7. ğŸ›¡ï¸ å¹¶å‘è®¿é—®æ§åˆ¶ç­–ç•¥


### 7.1 å¹¶å‘æ§åˆ¶çš„æ•´ä½“ç­–ç•¥


**ğŸ¯ æ§åˆ¶ç­–ç•¥å±‚æ¬¡**
```
å¹¶å‘æ§åˆ¶ç­–ç•¥é‡‘å­—å¡”ï¼š

          åº”ç”¨å±‚æ§åˆ¶
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ä¸šåŠ¡é€»è¾‘æ§åˆ¶ â”‚ â† æœ€é«˜å±‚ï¼šä¸šåŠ¡å±‚é¢çš„æ§åˆ¶
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ä»£ç å±‚æ§åˆ¶     â”‚ â† ä¸­é—´å±‚ï¼šsynchronizedã€Lockç­‰
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   æ¶æ„å±‚æ§åˆ¶        â”‚ â† åº•å±‚ï¼šæ— çŠ¶æ€è®¾è®¡ã€é›†ç¾¤ç­‰
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ— çŠ¶æ€è®¾è®¡åŸåˆ™


**ğŸ¯ ä»€ä¹ˆæ˜¯æ— çŠ¶æ€è®¾è®¡**
å°±åƒå…¬å…±å›¾ä¹¦é¦†çš„å€Ÿé˜…ç³»ç»Ÿï¼Œæ¯æ¬¡å€Ÿä¹¦éƒ½æ˜¯ç‹¬ç«‹çš„æ“ä½œï¼Œä¸ä¾èµ–ä¹‹å‰çš„å€Ÿé˜…çŠ¶æ€ã€‚Servletä¹Ÿåº”è¯¥è¿™æ ·è®¾è®¡ï¼šæ¯æ¬¡å¤„ç†è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¿å­˜çŠ¶æ€ä¿¡æ¯ã€‚

**âœ… æ— çŠ¶æ€Servletç¤ºä¾‹**
```java
// æ¨èï¼šæ— çŠ¶æ€è®¾è®¡
public class StatelessServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªè¯·æ±‚å‚æ•°æˆ–å¤–éƒ¨å­˜å‚¨
        String username = request.getParameter("username");
        String action = request.getParameter("action");
        
        // ä½¿ç”¨å±€éƒ¨å˜é‡å¤„ç†ä¸šåŠ¡
        UserService userService = new UserService();
        User user = userService.getUserByName(username);
        
        // å¤„ç†ç»“æœç›´æ¥è¿”å›ï¼Œä¸ä¿å­˜çŠ¶æ€
        if (user != null) {
            response.getWriter().println("ç”¨æˆ·ä¿¡æ¯: " + user.toString());
        } else {
            response.getWriter().println("ç”¨æˆ·ä¸å­˜åœ¨");
        }
    }
}
```

**âŒ æœ‰çŠ¶æ€è®¾è®¡çš„é—®é¢˜**
```java
// ä¸æ¨èï¼šæœ‰çŠ¶æ€è®¾è®¡
public class StatefulServlet extends HttpServlet {
    private User currentUser; // å®ä¾‹å˜é‡å­˜å‚¨çŠ¶æ€ - å±é™©ï¼
    private String lastAction; // ä¿å­˜ä¸Šæ¬¡æ“ä½œ - å±é™©ï¼
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        // è¿™ç§è®¾è®¡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºé—®é¢˜
        currentUser = getUserFromRequest(request);
        lastAction = request.getParameter("action");
        // ...
    }
}
```

### 7.3 è¯»å†™åˆ†ç¦»ç­–ç•¥


**ğŸ“š è¯»å†™åˆ†ç¦»çš„æ ¸å¿ƒæ€æƒ³**
æŠŠæ•°æ®æ“ä½œåˆ†ä¸ºä¸¤ç±»ï¼šè¯»æ“ä½œï¼ˆæŸ¥è¯¢ï¼‰å’Œå†™æ“ä½œï¼ˆä¿®æ”¹ï¼‰ã€‚è¯»æ“ä½œé€šå¸¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†™æ“ä½œéœ€è¦ç‰¹åˆ«ä¿æŠ¤ã€‚

**ğŸ”§ è¯»å†™é”åº”ç”¨**
```java
import java.util.concurrent.locks.ReadWriteLock;
import java.util.concurrent.locks.ReentrantReadWriteLock;

public class ConfigServlet extends HttpServlet {
    private Map<String, String> configMap = new HashMap<>();
    private final ReadWriteLock lock = new ReentrantReadWriteLock();
    
    // è¯»æ“ä½œï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        String key = request.getParameter("key");
        
        lock.readLock().lock(); // è·å–è¯»é”
        try {
            String value = configMap.get(key); // è¯»æ“ä½œ
            response.getWriter().println("é…ç½®å€¼: " + value);
        } finally {
            lock.readLock().unlock(); // é‡Šæ”¾è¯»é”
        }
    }
    
    // å†™æ“ä½œï¼šåªèƒ½ä¸€ä¸ªçº¿ç¨‹å†™å…¥
    @Override
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws IOException {
        
        String key = request.getParameter("key");
        String value = request.getParameter("value");
        
        lock.writeLock().lock(); // è·å–å†™é”
        try {
            configMap.put(key, value); // å†™æ“ä½œ
            response.getWriter().println("é…ç½®å·²æ›´æ–°");
        } finally {
            lock.writeLock().unlock(); // é‡Šæ”¾å†™é”
        }
    }
}
```

### 7.4 çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»


**ğŸ“Š é›†åˆç±»å®‰å…¨æ€§å¯¹æ¯”**

| é›†åˆç±»å‹ | çº¿ç¨‹å®‰å…¨æ€§ | æ€§èƒ½ | æ¨èåœºæ™¯ |
|---------|-----------|------|----------|
| **ArrayList** | âŒ ä¸å®‰å…¨ | ğŸŸ¢ é«˜ | å•çº¿ç¨‹ä½¿ç”¨ |
| **Vector** | âœ… å®‰å…¨ | ğŸŸ¡ ä¸­ | ç®€å•å¤šçº¿ç¨‹åœºæ™¯ |
| **CopyOnWriteArrayList** | âœ… å®‰å…¨ | ğŸ”´ è¯»å¿«å†™æ…¢ | è¯»å¤šå†™å°‘åœºæ™¯ |
| **HashMap** | âŒ ä¸å®‰å…¨ | ğŸŸ¢ é«˜ | å•çº¿ç¨‹ä½¿ç”¨ |
| **Hashtable** | âœ… å®‰å…¨ | ğŸŸ¡ ä¸­ | ç®€å•å¤šçº¿ç¨‹åœºæ™¯ |
| **ConcurrentHashMap** | âœ… å®‰å…¨ | ğŸŸ¢ é«˜ | é«˜å¹¶å‘åœºæ™¯ |

**ğŸ› ï¸ çº¿ç¨‹å®‰å…¨é›†åˆä½¿ç”¨ç¤ºä¾‹**
```java
public class SafeCollectionServlet extends HttpServlet {
    
    // ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆ
    private final Map<String, Integer> visitCount = 
        new ConcurrentHashMap<>();
    
    private final List<String> recentVisitors = 
        new CopyOnWriteArrayList<>();
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        String username = request.getParameter("username");
        
        // ConcurrentHashMapçš„åŸå­æ“ä½œ
        visitCount.merge(username, 1, Integer::sum); // çº¿ç¨‹å®‰å…¨çš„è®¡æ•°
        
        // CopyOnWriteArrayListçš„å®‰å…¨æ·»åŠ 
        if (recentVisitors.size() >= 100) {
            recentVisitors.remove(0); // ç§»é™¤æœ€è€çš„è®°å½•
        }
        recentVisitors.add(username);
        
        // è¾“å‡ºç»“æœ
        response.getWriter().println("ç”¨æˆ· " + username + 
            " è®¿é—®æ¬¡æ•°: " + visitCount.get(username));
    }
}
```

### 7.5 ç»¼åˆå¹¶å‘æ§åˆ¶ç­–ç•¥


**ğŸ—ï¸ åˆ†å±‚æ§åˆ¶æ¶æ„**
```
å®é™…é¡¹ç›®ä¸­çš„å¹¶å‘æ§åˆ¶ç­–ç•¥ï¼š

1. æ¶æ„å±‚é¢
   â”œâ”€â”€ æ— çŠ¶æ€è®¾è®¡
   â”œâ”€â”€ è¯»å†™åˆ†ç¦»
   â””â”€â”€ é›†ç¾¤éƒ¨ç½²

2. ä»£ç å±‚é¢  
   â”œâ”€â”€ çº¿ç¨‹å®‰å…¨é›†åˆ
   â”œâ”€â”€ ThreadLocaléš”ç¦»
   â””â”€â”€ åˆç†ä½¿ç”¨é”

3. æ•°æ®å±‚é¢
   â”œâ”€â”€ æ•°æ®åº“äº‹åŠ¡
   â”œâ”€â”€ ä¹è§‚é”æœºåˆ¶
   â””â”€â”€ ç¼“å­˜ç­–ç•¥

4. ç›‘æ§å±‚é¢
   â”œâ”€â”€ å¹¶å‘é‡ç›‘æ§
   â”œâ”€â”€ å“åº”æ—¶é—´è·Ÿè¸ª
   â””â”€â”€ å¼‚å¸¸æƒ…å†µå‘Šè­¦
```

**ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“**
```
å¹¶å‘æ§åˆ¶æœ€ä½³å®è·µï¼š

âœ… DO - åº”è¯¥åšçš„
â€¢ ä¼˜å…ˆè€ƒè™‘æ— çŠ¶æ€è®¾è®¡
â€¢ ä½¿ç”¨ThreadLocaléš”ç¦»çº¿ç¨‹æ•°æ®  
â€¢ é€‰æ‹©åˆé€‚çš„çº¿ç¨‹å®‰å…¨é›†åˆ
â€¢ æœ€å°åŒ–é”çš„èŒƒå›´å’Œæ—¶é—´
â€¢ åŠæ—¶æ¸…ç†ThreadLocalèµ„æº

âŒ DON'T - é¿å…åšçš„
â€¢ ä¸è¦åœ¨å®ä¾‹å˜é‡ä¸­å­˜å‚¨è¯·æ±‚ç›¸å…³æ•°æ®
â€¢ ä¸è¦ä½¿ç”¨éçº¿ç¨‹å®‰å…¨çš„é›†åˆå­˜å‚¨å…±äº«æ•°æ®
â€¢ ä¸è¦åœ¨é”å†…è¿›è¡Œè€—æ—¶æ“ä½œ
â€¢ ä¸è¦å¿˜è®°é‡Šæ”¾é”æˆ–æ¸…ç†èµ„æº
â€¢ ä¸è¦è¿‡åº¦ä½¿ç”¨synchronized
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Servletå¤šçº¿ç¨‹æ¨¡å‹æœ¬è´¨ï¼šä¸€ä¸ªå®ä¾‹ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨
ğŸ”¸ å•å®ä¾‹å¤šçº¿ç¨‹ä¼˜åŠ¿ï¼šèŠ‚çœå†…å­˜ï¼Œæé«˜æ€§èƒ½ï¼Œèµ„æºå…±äº«
ğŸ”¸ çº¿ç¨‹å®‰å…¨é—®é¢˜æ ¹æºï¼šå¤šçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«çš„å®ä¾‹å˜é‡
ğŸ”¸ åŒæ­¥æœºåˆ¶ä½œç”¨ï¼šé€šè¿‡åŠ é”ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®
ğŸ”¸ ThreadLocalä»·å€¼ï¼šä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹çš„æ•°æ®å­˜å‚¨ç©ºé—´
ğŸ”¸ å¹¶å‘æ§åˆ¶ç­–ç•¥ï¼šæ— çŠ¶æ€è®¾è®¡ + åˆç†åŒæ­¥ + çº¿ç¨‹å®‰å…¨é›†åˆ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦ç†è§£å¤šçº¿ç¨‹æ¨¡å‹ï¼Ÿ**
```
å®é™…åº”ç”¨ä»·å€¼ï¼š
â€¢ é¿å…ç”Ÿäº§ç¯å¢ƒçš„çº¿ç¨‹å®‰å…¨é—®é¢˜
â€¢ ç¼–å†™é«˜æ€§èƒ½çš„Webåº”ç”¨
â€¢ åˆç†è®¾è®¡å¹¶å‘è®¿é—®ç­–ç•¥
â€¢ å¿«é€Ÿå®šä½å’Œè§£å†³å¹¶å‘bug
â€¢ é€šè¿‡æŠ€æœ¯é¢è¯•çš„å¿…å¤‡çŸ¥è¯†
```

**ğŸ”¹ å¦‚ä½•åˆ¤æ–­ä»£ç æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ**
```
æ£€æŸ¥æ¸…å•ï¼š
1. æ˜¯å¦ä½¿ç”¨äº†å®ä¾‹å˜é‡ï¼Ÿ 
   â””â”€â”€ æœ‰åˆ™å¯èƒ½ä¸å®‰å…¨

2. å¯¹å®ä¾‹å˜é‡æ˜¯å¦åªè¯»ï¼Ÿ
   â””â”€â”€ åªè¯»ç›¸å¯¹å®‰å…¨ï¼Œè¯»å†™ä¸å®‰å…¨

3. æ˜¯å¦è¿›è¡Œå¤åˆæ“ä½œï¼Ÿ
   â””â”€â”€ å¦‚ i++ è¿™ç§è¯»-ä¿®æ”¹-å†™æ“ä½œ

4. æ˜¯å¦ä½¿ç”¨éçº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Ÿ
   â””â”€â”€ ArrayListã€HashMapç­‰

5. æ˜¯å¦æœ‰æ¡ä»¶åˆ¤æ–­åçš„æ“ä½œï¼Ÿ
   â””â”€â”€ if (count > 0) count--; è¿™ç§
```

**ğŸ”¹ é€‰æ‹©å“ªç§å¹¶å‘æ§åˆ¶æ–¹å¼ï¼Ÿ**
```
å†³ç­–æ ‘ï¼š
â”œâ”€â”€ èƒ½å¦é¿å…å…±äº«çŠ¶æ€ï¼Ÿ
â”‚   â””â”€â”€ æ˜¯ â†’ æ— çŠ¶æ€è®¾è®¡ï¼ˆæœ€ä¼˜é€‰æ‹©ï¼‰
â”‚   
â”œâ”€â”€ æ˜¯å¦éœ€è¦çº¿ç¨‹é—´æ•°æ®éš”ç¦»ï¼Ÿ
â”‚   â””â”€â”€ æ˜¯ â†’ ThreadLocal
â”‚   
â”œâ”€â”€ æ˜¯å¦è¯»å¤šå†™å°‘ï¼Ÿ
â”‚   â””â”€â”€ æ˜¯ â†’ è¯»å†™é”
â”‚   
â”œâ”€â”€ æ˜¯å¦ç®€å•çš„åŸå­æ“ä½œï¼Ÿ
â”‚   â””â”€â”€ æ˜¯ â†’ Atomicç±»æˆ–synchronized
â”‚   
â””â”€â”€ å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
    â””â”€â”€ synchronized + çº¿ç¨‹å®‰å…¨é›†åˆ
```

### 8.3 å®é™…å¼€å‘æŒ‡å¯¼


**ğŸ¯ å¼€å‘é˜¶æ®µæ³¨æ„äº‹é¡¹**
- **è®¾è®¡é˜¶æ®µ**ï¼šä¼˜å…ˆè€ƒè™‘æ— çŠ¶æ€è®¾è®¡
- **ç¼–ç é˜¶æ®µ**ï¼šé¿å…ä½¿ç”¨å®ä¾‹å˜é‡å­˜å‚¨è¯·æ±‚æ•°æ®
- **æµ‹è¯•é˜¶æ®µ**ï¼šè¿›è¡Œå¹¶å‘å‹åŠ›æµ‹è¯•
- **éƒ¨ç½²é˜¶æ®µ**ï¼šç›‘æ§å¹¶å‘è®¿é—®æƒ…å†µ

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**
```
é—®é¢˜ç±»å‹ â†’ è§£å†³æ–¹æ¡ˆ

æ•°æ®æ··ä¹± â†’ ä½¿ç”¨ThreadLocalæˆ–å±€éƒ¨å˜é‡
è®¡æ•°ä¸å‡† â†’ ä½¿ç”¨AtomicIntegeræˆ–synchronized
é›†åˆå¼‚å¸¸ â†’ ä½¿ç”¨ConcurrentHashMapç­‰çº¿ç¨‹å®‰å…¨é›†åˆ
æ€§èƒ½é—®é¢˜ â†’ å‡å°é”èŒƒå›´ï¼Œä½¿ç”¨è¯»å†™é”
å†…å­˜æ³„æ¼ â†’ åŠæ—¶æ¸…ç†ThreadLocal
```

**ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```
ä¼˜åŒ–å±‚æ¬¡ï¼š

1. æ¶æ„ä¼˜åŒ–ï¼ˆæ•ˆæœæœ€å¤§ï¼‰
   â””â”€â”€ æ— çŠ¶æ€è®¾è®¡ï¼Œé¿å…å…±äº«

2. ç®—æ³•ä¼˜åŒ–ï¼ˆæ•ˆæœæ˜æ˜¾ï¼‰  
   â””â”€â”€ å‡å°‘é”ç«äº‰ï¼Œä½¿ç”¨é«˜æ•ˆé›†åˆ

3. ä»£ç ä¼˜åŒ–ï¼ˆæ•ˆæœæœ‰é™ï¼‰
   â””â”€â”€ ç¼©å°é”èŒƒå›´ï¼Œé¿å…é‡å¤åŠ é”
```

### 8.4 å­¦ä¹ æ£€æŸ¥ç‚¹


**ğŸ“ è‡ªæˆ‘æ£€æµ‹é¢˜**

ğŸ¤” **ç†è§£æ£€æµ‹**
- Q: ä¸ºä»€ä¹ˆServletä½¿ç”¨å•å®ä¾‹å¤šçº¿ç¨‹æ¨¡å‹ï¼Ÿ
- Q: ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ
- Q: ThreadLocalæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹éš”ç¦»çš„ï¼Ÿ

ğŸ”§ **åº”ç”¨æ£€æµ‹**  
- Q: å¦‚ä½•æ”¹é€ ä¸€ä¸ªæœ‰çŠ¶æ€çš„Servletå˜æˆçº¿ç¨‹å®‰å…¨ï¼Ÿ
- Q: åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹é€‰æ‹©synchronized vs ThreadLocalï¼Ÿ
- Q: å¦‚ä½•è®¾è®¡ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„è®¿é—®è®¡æ•°å™¨ï¼Ÿ

**ğŸ’ª å®è·µæŒ‘æˆ˜**
```java
// è¯·åˆ†æä¸‹é¢ä»£ç çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¹¶ç»™å‡ºæ”¹è¿›æ–¹æ¡ˆ
public class ChallengeServlet extends HttpServlet {
    private List<String> userList = new ArrayList<>();
    private int maxUsers = 100;
    
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        String user = request.getParameter("user");
        
        if (userList.size() < maxUsers) {
            userList.add(user);
            response.getWriter().println("ç”¨æˆ·å·²æ·»åŠ ï¼Œå½“å‰äººæ•°ï¼š" + userList.size());
        } else {
            response.getWriter().println("ç”¨æˆ·å·²æ»¡");
        }
    }
}
```

### 8.5 æ‰©å±•å­¦ä¹ æ–¹å‘


**ğŸ“š æ·±å…¥å­¦ä¹ å»ºè®®**
```
åŸºç¡€å·©å›ºï¼š
â€¢ Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€ï¼ˆsynchronizedã€volatileã€Lockï¼‰
â€¢ JVMå†…å­˜æ¨¡å‹ç†è§£
â€¢ çº¿ç¨‹æ± å’Œå¹¶å‘å·¥å…·ç±»

è¿›é˜¶åº”ç”¨ï¼š
â€¢ åˆ†å¸ƒå¼å¹¶å‘æ§åˆ¶
â€¢ æ•°æ®åº“å¹¶å‘äº‹åŠ¡
â€¢ ç¼“å­˜å¹¶å‘æ›´æ–°ç­–ç•¥

å®æˆ˜é¡¹ç›®ï¼š
â€¢ é«˜å¹¶å‘Webåº”ç”¨è®¾è®¡
â€¢ ç§’æ€ç³»ç»Ÿçš„å¹¶å‘å¤„ç†
â€¢ åˆ†å¸ƒå¼é”çš„å®ç°
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€**
```
Servletå•å®ä¾‹ï¼Œå¤šçº¿ç¨‹æ¥è®¿é—®
å®ä¾‹å˜é‡å…±äº«ï¼Œçº¿ç¨‹å®‰å…¨è¦å°å¿ƒ
å±€éƒ¨å˜é‡å®‰å…¨ï¼ŒsynchronizedåŠ é”
ThreadLocaléš”ç¦»ï¼Œæ— çŠ¶æ€æœ€ä¼˜
è¯»å†™è¦åˆ†ç¦»ï¼Œé›†åˆé€‰å®‰å…¨
æµ‹è¯•è¦å¹¶å‘ï¼Œç›‘æ§ä¸èƒ½å¿˜
```

**æœ€åæé†’**ï¼šç†è®ºå­¦ä¹ å¾ˆé‡è¦ï¼Œä½†å®é™…åŠ¨æ‰‹å†™ä»£ç å’Œæµ‹è¯•æ›´é‡è¦ã€‚å»ºè®®åˆ›å»ºä¸€ä¸ªç®€å•çš„Webé¡¹ç›®ï¼Œå®é™…ä½“éªŒå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å„ç§æƒ…å†µï¼Œè¿™æ ·ç†è§£ä¼šæ›´æ·±åˆ»ï¼