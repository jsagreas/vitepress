---
title: 3ã€å¸¸è§é—®é¢˜è§£å†³
---
## ğŸ“š ç›®å½•


1. [å†…å­˜æ³„æ¼æ’æŸ¥ä¸è§£å†³](#1-å†…å­˜æ³„æ¼æ’æŸ¥ä¸è§£å†³)
2. [æ€§èƒ½ç“¶é¢ˆå®šä½ä¸ä¼˜åŒ–](#2-æ€§èƒ½ç“¶é¢ˆå®šä½ä¸ä¼˜åŒ–)
3. [å¹¶å‘é—®é¢˜è°ƒè¯•æŠ€å·§](#3-å¹¶å‘é—®é¢˜è°ƒè¯•æŠ€å·§)
4. [é…ç½®é”™è¯¯å¤„ç†æ–¹æ³•](#4-é…ç½®é”™è¯¯å¤„ç†æ–¹æ³•)
5. [éƒ¨ç½²é—®é¢˜è§£å†³æŒ‡å—](#5-éƒ¨ç½²é—®é¢˜è§£å†³æŒ‡å—)
6. [å…¼å®¹æ€§é—®é¢˜å¤„ç†](#6-å…¼å®¹æ€§é—®é¢˜å¤„ç†)
7. [æœ€ä½³å®è·µæ€»ç»“](#7-æœ€ä½³å®è·µæ€»ç»“)

---

## 1. ğŸ’¾ å†…å­˜æ³„æ¼æ’æŸ¥ä¸è§£å†³



### 1.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼



ğŸ¤” **ç®€å•ç†è§£**ï¼šæƒ³è±¡ä½ å®¶é‡Œçš„åƒåœ¾æ¡¶ï¼Œå¦‚æœä½ åªå¾€é‡Œé¢æ‰”åƒåœ¾ï¼Œä»æ¥ä¸æ¸…ç†ï¼Œæœ€ç»ˆåƒåœ¾æ¡¶å°±ä¼šæº¢å‡ºã€‚å†…å­˜æ³„æ¼å°±æ˜¯ç¨‹åºä¸æ–­å ç”¨å†…å­˜ï¼Œå´å¿˜è®°é‡Šæ”¾ä¸ç”¨çš„å†…å­˜ï¼Œæœ€ç»ˆå¯¼è‡´ç³»ç»Ÿå¡æ­»ã€‚

**ğŸ“‹ å†…å­˜æ³„æ¼çš„è¡¨ç°**ï¼š
- ğŸŒ åº”ç”¨è¿è¡Œè¶Šæ¥è¶Šæ…¢
- ğŸ’¥ ç»å¸¸å‡ºç° `OutOfMemoryError`
- ğŸ”„ æœåŠ¡å™¨éœ€è¦é¢‘ç¹é‡å¯
- ğŸ“ˆ å†…å­˜ä½¿ç”¨é‡æŒç»­ä¸Šå‡

### 1.2 Servletä¸­å¸¸è§çš„å†…å­˜æ³„æ¼åŸå› 



**ğŸ” ä¸»è¦æ³„æ¼ç‚¹åˆ†æ**ï¼š

| æ³„æ¼ç±»å‹ | **å…·ä½“è¡¨ç°** | **è§£å†³æ–¹æ³•** |
|---------|------------|------------|
| ğŸ—ƒï¸ **é›†åˆæœªæ¸…ç†** | `Listã€Mapç­‰å®¹å™¨ä¸æ–­å¢é•¿` | `åŠæ—¶clear()æˆ–è®¾ç½®ä¸Šé™` |
| ğŸ”— **ç›‘å¬å™¨æœªç§»é™¤** | `äº‹ä»¶ç›‘å¬å™¨å †ç§¯` | `æ‰‹åŠ¨removeListener()` |
| ğŸ“ **é™æ€å˜é‡æŒæœ‰å¯¹è±¡** | `staticå˜é‡å¼•ç”¨å¤§å¯¹è±¡` | `è®¾ç½®ä¸ºnullæˆ–ä½¿ç”¨å¼±å¼•ç”¨` |
| ğŸ§µ **çº¿ç¨‹æœªå…³é—­** | `åå°çº¿ç¨‹æŒç»­è¿è¡Œ` | `æ­£ç¡®shutdownçº¿ç¨‹æ± ` |

### 1.3 å†…å­˜æ³„æ¼æ’æŸ¥æ­¥éª¤



**ğŸ› ï¸ å®ç”¨æ’æŸ¥æ–¹æ³•**ï¼š

```java
// 1. åœ¨Servletä¸­æ·»åŠ å†…å­˜ç›‘æ§
public class MemoryMonitorServlet extends HttpServlet {
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        Runtime runtime = Runtime.getRuntime();
        long totalMemory = runtime.totalMemory();  // æ€»å†…å­˜
        long freeMemory = runtime.freeMemory();    // ç©ºé—²å†…å­˜
        long usedMemory = totalMemory - freeMemory; // å·²ç”¨å†…å­˜
        
        // è¾“å‡ºå†…å­˜ä½¿ç”¨æƒ…å†µ
        response.setContentType("text/plain;charset=UTF-8");
        PrintWriter out = response.getWriter();
        out.println("æ€»å†…å­˜: " + (totalMemory / 1024 / 1024) + "MB");
        out.println("å·²ç”¨å†…å­˜: " + (usedMemory / 1024 / 1024) + "MB");
        out.println("ç©ºé—²å†…å­˜: " + (freeMemory / 1024 / 1024) + "MB");
    }
}
```

**âš¡ å¿«é€Ÿå®šä½æŠ€å·§**ï¼š

```
ç¬¬ä¸€æ­¥ï¼šè§‚å¯Ÿç°è±¡
- è®¿é—® /memory-monitor æŸ¥çœ‹å†…å­˜ä½¿ç”¨
- å¤šæ¬¡åˆ·æ–°ï¼Œè§‚å¯Ÿå†…å­˜æ˜¯å¦æŒç»­å¢é•¿

ç¬¬äºŒæ­¥ï¼šä½¿ç”¨å·¥å…·åˆ†æ
- JVisualVMï¼šJavaè‡ªå¸¦çš„å¯è§†åŒ–å·¥å…·
- Eclipse MATï¼šä¸“ä¸šçš„å†…å­˜åˆ†æå·¥å…·
- JProfilerï¼šå•†ä¸šåˆ†æå·¥å…·ï¼ˆåŠŸèƒ½å¼ºå¤§ï¼‰

ç¬¬ä¸‰æ­¥ï¼šä»£ç å®¡æŸ¥é‡ç‚¹
âœ… æ£€æŸ¥æ‰€æœ‰é›†åˆæ˜¯å¦æœ‰clear()
âœ… ç¡®è®¤çº¿ç¨‹æ± æ˜¯å¦æ­£ç¡®å…³é—­
âœ… æŸ¥çœ‹é™æ€å˜é‡çš„ä½¿ç”¨
âœ… æ£€æŸ¥ç›‘å¬å™¨çš„æ³¨å†Œå’Œæ³¨é”€
```

### 1.4 é¢„é˜²å†…å­˜æ³„æ¼çš„ç¼–ç¨‹ä¹ æƒ¯



**ğŸ’¡ è‰¯å¥½çš„ç¼–ç¨‹å®è·µ**ï¼š

```java
// âœ… æ­£ç¡®çš„èµ„æºç®¡ç†ç¤ºä¾‹
public class SafeServlet extends HttpServlet {
    private List<String> cache = new ArrayList<>();
    private static final int MAX_CACHE_SIZE = 1000; // è®¾ç½®ä¸Šé™
    
    @Override
    public void doPost(HttpServletRequest request, HttpServletResponse response) {
        // 1. æ§åˆ¶é›†åˆå¤§å°
        if (cache.size() > MAX_CACHE_SIZE) {
            cache.clear(); // åŠæ—¶æ¸…ç†
        }
        
        // 2. ä½¿ç”¨try-with-resources
        try (PrintWriter out = response.getWriter()) {
            out.println("æ•°æ®å¤„ç†å®Œæˆ");
        } // è‡ªåŠ¨å…³é—­èµ„æº
    }
    
    @Override
    public void destroy() {
        // 3. åœ¨é”€æ¯æ—¶æ¸…ç†èµ„æº
        if (cache != null) {
            cache.clear();
            cache = null;
        }
        super.destroy();
    }
}
```

---

## 2. ğŸ“ˆ æ€§èƒ½ç“¶é¢ˆå®šä½ä¸ä¼˜åŒ–



### 2.1 æ€§èƒ½é—®é¢˜çš„å¸¸è§è¡¨ç°



ğŸ¯ **ç”¨æˆ·èƒ½æ„Ÿå—åˆ°çš„é—®é¢˜**ï¼š
- ğŸŒ é¡µé¢åŠ è½½è¶…è¿‡3ç§’
- â³ ç‚¹å‡»æŒ‰é’®åé•¿æ—¶é—´æ— å“åº”
- ğŸ”„ ç³»ç»Ÿç»å¸¸å‡ºç°è¶…æ—¶é”™è¯¯
- ğŸ“± ç§»åŠ¨ç«¯ä½“éªŒç‰¹åˆ«å¡é¡¿

### 2.2 æ€§èƒ½ç“¶é¢ˆçš„ä¸»è¦ç±»å‹



**ğŸ” ç“¶é¢ˆç±»å‹åˆ†æ**ï¼š

```
CPUå¯†é›†å‹é—®é¢˜ï¼š
â”œâ”€ å¤æ‚ç®—æ³•è®¡ç®—è¿‡å¤š
â”œâ”€ å¤§é‡å¾ªç¯å’Œé€’å½’
â””â”€ æ­£åˆ™è¡¨è¾¾å¼è¿‡äºå¤æ‚

IOå¯†é›†å‹é—®é¢˜ï¼š
â”œâ”€ æ•°æ®åº“æŸ¥è¯¢ç¼“æ…¢
â”œâ”€ æ–‡ä»¶è¯»å†™é¢‘ç¹
â””â”€ ç½‘ç»œè¯·æ±‚è¿‡å¤š

å†…å­˜é—®é¢˜ï¼š
â”œâ”€ å¯¹è±¡åˆ›å»ºè¿‡äºé¢‘ç¹
â”œâ”€ å¤§å¯¹è±¡å ç”¨å†…å­˜
â””â”€ åƒåœ¾å›æ”¶é¢‘ç¹
```

### 2.3 æ€§èƒ½ç›‘æ§ä¸æµ‹é‡



**ğŸ“Š å®ç”¨çš„æ€§èƒ½ç›‘æ§æ–¹æ³•**ï¼š

```java
// ç®€å•çš„æ€§èƒ½ç›‘æ§å·¥å…·ç±»
public class PerformanceMonitor {
    private long startTime;
    private String operation;
    
    public PerformanceMonitor(String operation) {
        this.operation = operation;
        this.startTime = System.currentTimeMillis();
        System.out.println("[å¼€å§‹] " + operation);
    }
    
    public void end() {
        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;
        System.out.println("[å®Œæˆ] " + operation + " è€—æ—¶: " + duration + "ms");
        
        // ğŸš¨ è¶…è¿‡1ç§’çš„æ“ä½œéœ€è¦å…³æ³¨
        if (duration > 1000) {
            System.out.println("âš ï¸ è­¦å‘Š: " + operation + " æ‰§è¡Œæ—¶é—´è¿‡é•¿!");
        }
    }
}
```

**ğŸ› ï¸ åœ¨Servletä¸­ä½¿ç”¨**ï¼š

```java
@Override
public void doGet(HttpServletRequest request, HttpServletResponse response) {
    PerformanceMonitor monitor = new PerformanceMonitor("ç”¨æˆ·æŸ¥è¯¢æ“ä½œ");
    
    try {
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        List<User> users = userService.getAllUsers();
        
        // è¾“å‡ºç»“æœ
        response.setContentType("application/json;charset=UTF-8");
        PrintWriter out = response.getWriter();
        out.println(convertToJson(users));
        
    } finally {
        monitor.end(); // ç¡®ä¿æ€»æ˜¯è®°å½•æ—¶é—´
    }
}
```

### 2.4 å¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥



**âš¡ ç«‹ç«¿è§å½±çš„ä¼˜åŒ–æ–¹æ³•**ï¼š

| ä¼˜åŒ–ç­–ç•¥ | **ä½¿ç”¨åœºæ™¯** | **æ•ˆæœ** | **å®ç°éš¾åº¦** |
|---------|-----------|---------|-------------|
| ğŸ—„ï¸ **æ•°æ®åº“è¿æ¥æ± ** | `é¢‘ç¹æ•°æ®åº“æ“ä½œ` | `â˜…â˜…â˜…â˜…â˜…` | `â˜…â˜†â˜†â˜†â˜†` |
| ğŸ“¦ **ç¼“å­˜æœºåˆ¶** | `é‡å¤æŸ¥è¯¢ç›¸åŒæ•°æ®` | `â˜…â˜…â˜…â˜…â˜…` | `â˜…â˜…â˜†â˜†â˜†` |
| ğŸ§µ **å¼‚æ­¥å¤„ç†** | `è€—æ—¶æ“ä½œä¸é˜»å¡å“åº”` | `â˜…â˜…â˜…â˜…â˜†` | `â˜…â˜…â˜…â˜†â˜†` |
| ğŸ“ **å‡å°‘å¯¹è±¡åˆ›å»º** | `é«˜å¹¶å‘åœºæ™¯` | `â˜…â˜…â˜…â˜†â˜†` | `â˜…â˜…â˜†â˜†â˜†` |

**ğŸ’° ç¼“å­˜ä¼˜åŒ–ç¤ºä¾‹**ï¼š

```java
public class CachedUserServlet extends HttpServlet {
    // ç®€å•çš„å†…å­˜ç¼“å­˜
    private static Map<String, User> userCache = new ConcurrentHashMap<>();
    private static long lastUpdateTime = 0;
    private static final long CACHE_EXPIRE_TIME = 5 * 60 * 1000; // 5åˆ†é’Ÿ
    
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        String userId = request.getParameter("id");
        
        // 1ï¸âƒ£ å…ˆæ£€æŸ¥ç¼“å­˜
        User user = getUserFromCache(userId);
        if (user != null) {
            System.out.println("âœ… ä»ç¼“å­˜è·å–ç”¨æˆ·: " + userId);
            outputUser(response, user);
            return;
        }
        
        // 2ï¸âƒ£ ç¼“å­˜æ²¡æœ‰ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        System.out.println("ğŸ“€ ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·: " + userId);
        user = userService.getUserById(userId);
        
        // 3ï¸âƒ£ å­˜å…¥ç¼“å­˜
        if (user != null) {
            userCache.put(userId, user);
        }
        
        outputUser(response, user);
    }
    
    private User getUserFromCache(String userId) {
        // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
        if (System.currentTimeMillis() - lastUpdateTime > CACHE_EXPIRE_TIME) {
            userCache.clear(); // æ¸…ç†è¿‡æœŸç¼“å­˜
            lastUpdateTime = System.currentTimeMillis();
            return null;
        }
        
        return userCache.get(userId);
    }
}
```

---

## 3. ğŸ§µ å¹¶å‘é—®é¢˜è°ƒè¯•æŠ€å·§



### 3.1 ä»€ä¹ˆæ˜¯å¹¶å‘é—®é¢˜



ğŸ¤” **ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šæƒ³è±¡é“¶è¡Œå–æ¬¾æœºï¼Œå¦‚æœä¸¤ä¸ªäººåŒæ—¶ä»åŒä¸€ä¸ªè´¦æˆ·å–é’±ï¼Œä½†ç³»ç»Ÿæ²¡æœ‰å¤„ç†å¥½å¹¶å‘ï¼Œå¯èƒ½ä¼šå¯¼è‡´è´¦æˆ·ä½™é¢å‡ºé”™ã€‚åœ¨Webåº”ç”¨ä¸­ï¼Œå¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®å¯èƒ½å¼•èµ·æ•°æ®é”™ä¹±ã€‚

**ğŸ“‹ å¹¶å‘é—®é¢˜çš„å…¸å‹è¡¨ç°**ï¼š
- ğŸ”€ æ•°æ®ä¸ä¸€è‡´ï¼ˆåŒä¸€æ•°æ®æ˜¾ç¤ºä¸åŒå€¼ï¼‰
- ğŸ” æ­»é”ï¼ˆç¨‹åºå¡æ­»ä¸åŠ¨ï¼‰
- ğŸƒ ç«æ€æ¡ä»¶ï¼ˆç»“æœä¸å¯é¢„æµ‹ï¼‰
- ğŸ“Š è®¡æ•°å™¨ä¸å‡†ç¡®

### 3.2 Servletå¹¶å‘é—®é¢˜çš„æ ¹æœ¬åŸå› 



**ğŸ” æŠ€æœ¯åŸç†åˆ†æ**ï¼š

```
Servletçš„å¹¶å‘ç‰¹æ€§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webå®¹å™¨        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    å¤šä¸ªç”¨æˆ·è¯·æ±‚
â”‚  â”‚   Servlet   â”‚ â”œâ”€â”€â”€ ç”¨æˆ·A â”€â”€â”
â”‚  â”‚   (å•ä¾‹)    â”‚ â”œâ”€â”€â”€ ç”¨æˆ·B â”€â”€â”¼â”€â”€ åŒæ—¶è®¿é—®åŒä¸€ä¸ªServletå®ä¾‹
â”‚  â”‚             â”‚ â”œâ”€â”€â”€ ç”¨æˆ·C â”€â”€â”˜
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼šä¸€ä¸ªServletå®ä¾‹è¢«å¤šä¸ªçº¿ç¨‹å…±äº«
ç»“æœï¼šå¦‚æœæœ‰å…±äº«å˜é‡ï¼Œå°±å¯èƒ½å‡ºç°å¹¶å‘é—®é¢˜
```

### 3.3 è¯†åˆ«å¹¶å‘é—®é¢˜çš„æ–¹æ³•



**ğŸ› ï¸ å®ç”¨æ£€æµ‹æŠ€å·§**ï¼š

```java
// ç”¨äºæµ‹è¯•å¹¶å‘é—®é¢˜çš„Servlet
public class ConcurrencyTestServlet extends HttpServlet {
    private int counter = 0; // âŒ å±é™©ï¼šå®ä¾‹å˜é‡åœ¨å¤šçº¿ç¨‹é—´å…±äº«
    
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        // æ¨¡æ‹Ÿå¹¶å‘é—®é¢˜
        int currentValue = counter;
        
        // æ¨¡æ‹Ÿä¸€äº›å¤„ç†æ—¶é—´
        try {
            Thread.sleep(100); // 100æ¯«ç§’å»¶è¿Ÿ
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        
        counter = currentValue + 1; // å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹è¦†ç›–
        
        response.setContentType("text/plain;charset=UTF-8");
        PrintWriter out = response.getWriter();
        out.println("å½“å‰çº¿ç¨‹: " + Thread.currentThread().getName());
        out.println("è®¡æ•°å™¨å€¼: " + counter);
        out.println("æœŸæœ›å€¼å¯èƒ½ä¸ä¸€è‡´ï¼");
    }
}
```

**ğŸ” é—®é¢˜æ£€æµ‹æ­¥éª¤**ï¼š

```
ç¬¬ä¸€æ­¥ï¼šå¤šçº¿ç¨‹å‹åŠ›æµ‹è¯•
- ä½¿ç”¨JMeteræˆ–ç®€å•è„šæœ¬åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚
- è§‚å¯Ÿæ•°æ®æ˜¯å¦ä¸€è‡´

ç¬¬äºŒæ­¥ï¼šæ·»åŠ æ—¥å¿—è®°å½•
- è®°å½•æ¯ä¸ªçº¿ç¨‹çš„æ“ä½œæ—¶é—´
- è®°å½•å…±äº«å˜é‡çš„å˜åŒ–

ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨çº¿ç¨‹å®‰å…¨å·¥å…·
- ä½¿ç”¨AtomicIntegeræ›¿ä»£int
- ä½¿ç”¨ConcurrentHashMapæ›¿ä»£HashMap
```

### 3.4 è§£å†³å¹¶å‘é—®é¢˜çš„æ–¹æ³•



**ğŸ’¡ å®ç”¨è§£å†³æ–¹æ¡ˆ**ï¼š

| è§£å†³æ–¹æ³• | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|-----------|---------|--------|
| ğŸ”’ **synchronized** | `ç®€å•çš„åŒæ­¥éœ€æ±‚` | `ç®€å•æ˜“ç”¨` | `æ€§èƒ½å¼€é”€å¤§` |
| âš¡ **åŸå­ç±»æ“ä½œ** | `è®¡æ•°å™¨ã€æ ‡å¿—ä½` | `æ€§èƒ½å¥½` | `åªé€‚ç”¨ç®€å•æ“ä½œ` |
| ğŸ—„ï¸ **ThreadLocal** | `æ¯çº¿ç¨‹ç‹¬ç«‹æ•°æ®` | `æ— é”å¼€é”€` | `å†…å­˜å ç”¨å¤š` |
| ğŸš« **é¿å…å®ä¾‹å˜é‡** | `çŠ¶æ€æ— å…³æ“ä½œ` | `å¤©ç„¶çº¿ç¨‹å®‰å…¨` | `éœ€è¦é‡æ„ä»£ç ` |

**âœ… çº¿ç¨‹å®‰å…¨çš„æ”¹è¿›ç‰ˆæœ¬**ï¼š

```java
public class SafeConcurrencyServlet extends HttpServlet {
    // âœ… ä½¿ç”¨åŸå­ç±»ä¿è¯çº¿ç¨‹å®‰å…¨
    private AtomicInteger counter = new AtomicInteger(0);
    
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        // åŸå­æ“ä½œï¼Œçº¿ç¨‹å®‰å…¨
        int newValue = counter.incrementAndGet();
        
        response.setContentType("text/plain;charset=UTF-8");
        PrintWriter out = response.getWriter();
        out.println("å½“å‰çº¿ç¨‹: " + Thread.currentThread().getName());
        out.println("å®‰å…¨çš„è®¡æ•°å™¨å€¼: " + newValue);
        out.println("âœ… æ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯");
    }
}
```

---

## 4. âš™ï¸ é…ç½®é”™è¯¯å¤„ç†æ–¹æ³•



### 4.1 å¸¸è§çš„é…ç½®é”™è¯¯ç±»å‹



ğŸ¤” **ä¸ºä»€ä¹ˆé…ç½®å®¹æ˜“å‡ºé”™**ï¼šé…ç½®å°±åƒç»™ç¨‹åºå†™"ä½¿ç”¨è¯´æ˜ä¹¦"ï¼Œä¸€ä¸ªå­—æ¯å†™é”™ï¼Œç¨‹åºå°±"çœ‹ä¸æ‡‚"äº†ã€‚

**ğŸ“‹ å…¸å‹é…ç½®é”™è¯¯**ï¼š

| é”™è¯¯ç±»å‹ | **å…·ä½“è¡¨ç°** | **å½±å“** |
|---------|------------|---------|
| ğŸŒ **web.xmlé…ç½®é”™è¯¯** | `Servletæ˜ å°„å¤±æ•ˆ` | `404é”™è¯¯æˆ–500é”™è¯¯` |
| ğŸ“ **æ³¨è§£é…ç½®å†²çª** | `@WebServletä¸web.xmlå†²çª` | `å¯åŠ¨å¼‚å¸¸` |
| ğŸ“‚ **è·¯å¾„é…ç½®é”™è¯¯** | `èµ„æºæ–‡ä»¶æ‰¾ä¸åˆ°` | `æ–‡ä»¶åŠ è½½å¤±è´¥` |
| ğŸ—„ï¸ **æ•°æ®åº“è¿æ¥é…ç½®** | `è¿æ¥å‚æ•°é”™è¯¯` | `æ— æ³•è¿æ¥æ•°æ®åº“` |

### 4.2 web.xmlé…ç½®é—®é¢˜æ’æŸ¥



**ğŸ› ï¸ é€æ­¥æ’æŸ¥æ–¹æ³•**ï¼š

```xml
<!-- å¸¸è§çš„web.xmlé…ç½®ç¤ºä¾‹ -->
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://java.sun.com/xml/ns/javaee"
         version="3.0">
    
    <!-- âœ… æ­£ç¡®çš„Servleté…ç½® -->
    <servlet>
        <servlet-name>HelloServlet</servlet-name>
        <servlet-class>com.example.HelloServlet</servlet-class>
        <!-- ğŸ¯ åˆå§‹åŒ–å‚æ•° -->
        <init-param>
            <param-name>message</param-name>
            <param-value>Hello World</param-value>
        </init-param>
    </servlet>
    
    <!-- âš ï¸ URLæ˜ å°„è¦åŒ¹é… -->
    <servlet-mapping>
        <servlet-name>HelloServlet</servlet-name> <!-- å¿…é¡»ä¸ä¸Šé¢ä¸€è‡´ -->
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>
    
    <!-- ğŸ  é»˜è®¤é¡µé¢è®¾ç½® -->
    <welcome-file-list>
        <welcome-file>index.jsp</welcome-file>
        <welcome-file>index.html</welcome-file>
    </welcome-file-list>
    
</web-app>
```

**ğŸ” é…ç½®é”™è¯¯æ£€æŸ¥æ¸…å•**ï¼š

```
ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬è¯­æ³•æ£€æŸ¥
â–¡ XMLæ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆæ ‡ç­¾é…å¯¹ï¼‰
â–¡ servlet-nameæ˜¯å¦åœ¨ä¸¤å¤„å®Œå…¨ä¸€è‡´
â–¡ servlet-classçš„åŒ…åå’Œç±»åæ˜¯å¦æ­£ç¡®

ç¬¬äºŒæ­¥ï¼šè·¯å¾„æ£€æŸ¥
â–¡ url-patternæ˜¯å¦ä»¥ / å¼€å¤´
â–¡ æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨
â–¡ å¤§å°å†™æ˜¯å¦åŒ¹é…ï¼ˆLinuxåŒºåˆ†å¤§å°å†™ï¼‰

ç¬¬ä¸‰æ­¥ï¼šç‰ˆæœ¬å…¼å®¹æ€§
â–¡ web.xmlç‰ˆæœ¬æ˜¯å¦ä¸æœåŠ¡å™¨åŒ¹é…
â–¡ æ³¨è§£å’ŒXMLé…ç½®æ˜¯å¦å†²çª
```

### 4.3 æ³¨è§£é…ç½®é—®é¢˜è§£å†³



**ğŸ’¡ æ³¨è§£é…ç½®æœ€ä½³å®è·µ**ï¼š

```java
// âœ… æ­£ç¡®çš„æ³¨è§£é…ç½®
@WebServlet(
    name = "UserServlet",
    urlPatterns = {"/user/*", "/users"}, // æ”¯æŒå¤šä¸ªURLæ¨¡å¼
    initParams = {
        @WebInitParam(name = "encoding", value = "UTF-8")
    },
    loadOnStartup = 1 // å¯åŠ¨æ—¶å°±åŠ è½½
)
public class UserServlet extends HttpServlet {
    
    @Override
    public void init() throws ServletException {
        String encoding = getInitParameter("encoding");
        System.out.println("âœ… ç¼–ç è®¾ç½®: " + encoding);
    }
    
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) {
        // å¤„ç†ç”¨æˆ·è¯·æ±‚
    }
}
```

**âš ï¸ é¿å…é…ç½®å†²çª**ï¼š

```
å†²çªæƒ…å†µï¼šweb.xmlå’Œæ³¨è§£åŒæ—¶é…ç½®åŒä¸€ä¸ªServlet

è§£å†³æ–¹æ¡ˆï¼š
1ï¸âƒ£ åªä½¿ç”¨ä¸€ç§æ–¹å¼ï¼ˆæ¨èæ³¨è§£ï¼‰
2ï¸âƒ£ åœ¨web.xmlä¸­è®¾ç½® metadata-complete="true" å¿½ç•¥æ³¨è§£
3ï¸âƒ£ ç¡®ä¿é…ç½®ä¿¡æ¯ä¸€è‡´

æœ€ä½³å®è·µï¼š
âœ… æ–°é¡¹ç›®ä¼˜å…ˆä½¿ç”¨æ³¨è§£
âœ… è€é¡¹ç›®é€æ­¥è¿ç§»åˆ°æ³¨è§£
âœ… ä¸è¦æ··åˆä½¿ç”¨ä¸¤ç§æ–¹å¼é…ç½®åŒä¸€ç»„ä»¶
```

### 4.4 å¿«é€Ÿå®šä½é…ç½®é—®é¢˜çš„å·¥å…·



**ğŸ› ï¸ å®ç”¨è°ƒè¯•æŠ€å·§**ï¼š

```java
// é…ç½®ä¿¡æ¯æ£€æŸ¥Servlet
@WebServlet("/config-check")
public class ConfigCheckServlet extends HttpServlet {
    
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        
        out.println("<h2>ğŸ” é…ç½®ä¿¡æ¯æ£€æŸ¥</h2>");
        
        // 1. æ£€æŸ¥Servleté…ç½®
        out.println("<h3>Servletä¿¡æ¯ï¼š</h3>");
        out.println("Servletåç§°: " + getServletName() + "<br>");
        out.println("Servletç±»: " + getClass().getName() + "<br>");
        
        // 2. æ£€æŸ¥åˆå§‹åŒ–å‚æ•°
        out.println("<h3>åˆå§‹åŒ–å‚æ•°ï¼š</h3>");
        Enumeration<String> paramNames = getInitParameterNames();
        while (paramNames.hasMoreElements()) {
            String paramName = paramNames.nextElement();
            String paramValue = getInitParameter(paramName);
            out.println(paramName + " = " + paramValue + "<br>");
        }
        
        // 3. æ£€æŸ¥ä¸Šä¸‹æ–‡è·¯å¾„
        out.println("<h3>è·¯å¾„ä¿¡æ¯ï¼š</h3>");
        out.println("ä¸Šä¸‹æ–‡è·¯å¾„: " + request.getContextPath() + "<br>");
        out.println("è¯·æ±‚URI: " + request.getRequestURI() + "<br>");
        out.println("Servletè·¯å¾„: " + request.getServletPath() + "<br>");
    }
}
```

---

## 5. ğŸš€ éƒ¨ç½²é—®é¢˜è§£å†³æŒ‡å—



### 5.1 éƒ¨ç½²ç¯å¢ƒçš„å¸¸è§é—®é¢˜



ğŸ¤” **ä»€ä¹ˆæ˜¯éƒ¨ç½²é—®é¢˜**ï¼šå°±åƒæ¬å®¶ä¸€æ ·ï¼Œç¨‹åºä»å¼€å‘ç¯å¢ƒ"æ¬"åˆ°ç”Ÿäº§æœåŠ¡å™¨æ—¶ï¼Œå¯èƒ½å› ä¸ºç¯å¢ƒä¸åŒè€Œå‡ºç°é—®é¢˜ã€‚

**ğŸ“‹ å…¸å‹éƒ¨ç½²é—®é¢˜**ï¼š

```
å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¯å¢ƒè¦ç´    â”‚   å¼€å‘ç¯å¢ƒ   â”‚   ç”Ÿäº§ç¯å¢ƒ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ  æ“ä½œç³»ç»Ÿ   â”‚ Windows      â”‚ Linux        â”‚
â”‚ â˜• Javaç‰ˆæœ¬   â”‚ JDK 11       â”‚ JDK 8        â”‚
â”‚ ğŸ–¥ï¸ æœåŠ¡å™¨     â”‚ Tomcat 9     â”‚ Tomcat 8     â”‚
â”‚ ğŸ—„ï¸ æ•°æ®åº“     â”‚ MySQLæœ¬åœ°    â”‚ MySQLé›†ç¾¤    â”‚
â”‚ ğŸ“ æ–‡ä»¶è·¯å¾„   â”‚ D:\project   â”‚ /opt/webapp  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 WARåŒ…éƒ¨ç½²é—®é¢˜è§£å†³



**ğŸ“¦ WARåŒ…åˆ¶ä½œä¸éƒ¨ç½²æµç¨‹**ï¼š

```
WARåŒ…ç»“æ„æ£€æŸ¥ï¼š
your-app.war
â”œâ”€â”€ WEB-INF/
â”‚   â”œâ”€â”€ web.xml          â† é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ classes/         â† Javaç±»æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ com/example/
â”‚   â””â”€â”€ lib/            â† ä¾èµ–JARåŒ…
â”œâ”€â”€ index.jsp           â† JSPé¡µé¢
â”œâ”€â”€ css/               â† é™æ€èµ„æº
â”‚   â””â”€â”€ style.css
â””â”€â”€ js/
    â””â”€â”€ app.js

âœ… æ£€æŸ¥è¦ç‚¹ï¼š
â–¡ WEB-INFç›®å½•ç»“æ„æ­£ç¡®
â–¡ æ‰€æœ‰ä¾èµ–åº“éƒ½åœ¨libç›®å½•
â–¡ é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®
â–¡ é™æ€èµ„æºæ–‡ä»¶å®Œæ•´
```

**ğŸ› ï¸ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•**ï¼š

```java
// éƒ¨ç½²çŠ¶æ€æ£€æŸ¥Servlet
@WebServlet("/deploy-check")
public class DeployCheckServlet extends HttpServlet {
    
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        
        out.println("<h2>ğŸš€ éƒ¨ç½²çŠ¶æ€æ£€æŸ¥</h2>");
        
        // 1. Javaç¯å¢ƒæ£€æŸ¥
        out.println("<h3>Javaç¯å¢ƒï¼š</h3>");
        out.println("Javaç‰ˆæœ¬: " + System.getProperty("java.version") + "<br>");
        out.println("æ“ä½œç³»ç»Ÿ: " + System.getProperty("os.name") + "<br>");
        
        // 2. æœåŠ¡å™¨ä¿¡æ¯
        out.println("<h3>æœåŠ¡å™¨ä¿¡æ¯ï¼š</h3>");
        out.println("æœåŠ¡å™¨ä¿¡æ¯: " + getServletContext().getServerInfo() + "<br>");
        
        // 3. åº”ç”¨è·¯å¾„
        out.println("<h3>åº”ç”¨è·¯å¾„ï¼š</h3>");
        out.println("çœŸå®è·¯å¾„: " + getServletContext().getRealPath("/") + "<br>");
        
        // 4. èµ„æºæ–‡ä»¶æ£€æŸ¥
        out.println("<h3>èµ„æºæ–‡ä»¶æ£€æŸ¥ï¼š</h3>");
        checkResource(out, "/WEB-INF/web.xml", "é…ç½®æ–‡ä»¶");
        checkResource(out, "/css/style.css", "CSSæ–‡ä»¶");
        checkResource(out, "/js/app.js", "JavaScriptæ–‡ä»¶");
    }
    
    private void checkResource(PrintWriter out, String path, String description) {
        URL resource = getServletContext().getResource(path);
        if (resource != null) {
            out.println("âœ… " + description + " å­˜åœ¨: " + path + "<br>");
        } else {
            out.println("âŒ " + description + " ç¼ºå¤±: " + path + "<br>");
        }
    }
}
```

### 5.3 æ•°æ®åº“è¿æ¥é—®é¢˜è§£å†³



**ğŸ—„ï¸ æ•°æ®åº“é…ç½®é—®é¢˜æ’æŸ¥**ï¼š

```java
// æ•°æ®åº“è¿æ¥æµ‹è¯•å·¥å…·
public class DatabaseTestServlet extends HttpServlet {
    
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws IOException {
        
        response.setContentType("text/plain;charset=UTF-8");
        PrintWriter out = response.getWriter();
        
        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        String url = "jdbc:mysql://localhost:3306/testdb";
        String username = "root";
        String password = "password";
        
        try {
            // 1. åŠ è½½æ•°æ®åº“é©±åŠ¨
            Class.forName("com.mysql.jdbc.Driver");
            out.println("âœ… æ•°æ®åº“é©±åŠ¨åŠ è½½æˆåŠŸ");
            
            // 2. å»ºç«‹è¿æ¥
            Connection conn = DriverManager.getConnection(url, username, password);
            out.println("âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ");
            
            // 3. æµ‹è¯•æŸ¥è¯¢
            Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery("SELECT 1 as test");
            
            if (rs.next()) {
                out.println("âœ… æ•°æ®åº“æŸ¥è¯¢æˆåŠŸ: " + rs.getInt("test"));
            }
            
            // 4. å…³é—­è¿æ¥
            rs.close();
            stmt.close();
            conn.close();
            out.println("âœ… è¿æ¥æ­£å¸¸å…³é—­");
            
        } catch (ClassNotFoundException e) {
            out.println("âŒ æ•°æ®åº“é©±åŠ¨æœªæ‰¾åˆ°: " + e.getMessage());
        } catch (SQLException e) {
            out.println("âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: " + e.getMessage());
        }
    }
}
```

### 5.4 æƒé™å’Œå®‰å…¨é—®é¢˜



**ğŸ”’ å¸¸è§æƒé™é—®é¢˜è§£å†³**ï¼š

| é—®é¢˜ç±»å‹ | **ç—‡çŠ¶** | **è§£å†³æ–¹æ³•** |
|---------|---------|------------|
| ğŸ“ **æ–‡ä»¶è¯»å†™æƒé™** | `æ— æ³•åˆ›å»ºæ—¥å¿—æ–‡ä»¶` | `chmod 755 /opt/webapp` |
| ğŸŒ **ç«¯å£è®¿é—®æƒé™** | `8080ç«¯å£æ‹’ç»è®¿é—®` | `æ£€æŸ¥é˜²ç«å¢™è®¾ç½®` |
| ğŸ—„ï¸ **æ•°æ®åº“æƒé™** | `Access denied` | `GRANTæƒé™ç»™ç”¨æˆ·` |
| ğŸ“ **é…ç½®æ–‡ä»¶æƒé™** | `æ— æ³•è¯»å–web.xml` | `chown tomcat:tomcat web.xml` |

---

## 6. ğŸ”„ å…¼å®¹æ€§é—®é¢˜å¤„ç†



### 6.1 ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜



ğŸ¤” **ä¸ºä»€ä¹ˆä¼šæœ‰å…¼å®¹æ€§é—®é¢˜**ï¼šå°±åƒä¸åŒå‹å·çš„æ‰‹æœºå……ç”µå™¨ä¸èƒ½é€šç”¨ä¸€æ ·ï¼Œä¸åŒç‰ˆæœ¬çš„Javaå’ŒæœåŠ¡å™¨ä¹Ÿå¯èƒ½ä¸å…¼å®¹ã€‚

**ğŸ“‹ å¸¸è§å…¼å®¹æ€§é—®é¢˜**ï¼š

```
ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tomcat    â”‚  Java 8 â”‚ Java 11 â”‚ Java 17 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tomcat 8.5  â”‚    âœ…   â”‚    âœ…   â”‚    âŒ   â”‚
â”‚ Tomcat 9.0  â”‚    âœ…   â”‚    âœ…   â”‚    âœ…   â”‚
â”‚ Tomcat 10.0 â”‚    âŒ   â”‚    âœ…   â”‚    âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ æ³¨æ„ï¼šTomcat 10.0 ä½¿ç”¨ Jakarta EEï¼ŒåŒ…åä» javax.* æ”¹ä¸º jakarta.*
```

### 6.2 APIå…¼å®¹æ€§å¤„ç†



**ğŸ”§ APIå˜åŒ–é€‚é…æ–¹æ³•**ï¼š

```java
// å…¼å®¹ä¸åŒç‰ˆæœ¬çš„å†™æ³•
public class CompatibilityServlet extends HttpServlet {
    
    @Override
    public void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // è§£å†³ä¸­æ–‡ç¼–ç é—®é¢˜ï¼ˆé€‚ç”¨äºå„ä¸ªç‰ˆæœ¬ï¼‰
        request.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        
        // è·å–è¯·æ±‚å‚æ•°
        String name = request.getParameter("name");
        
        // âœ… å®‰å…¨çš„ç©ºå€¼æ£€æŸ¥ï¼ˆé¿å…NullPointerExceptionï¼‰
        if (name == null || name.trim().isEmpty()) {
            name = "åŒ¿åç”¨æˆ·";
        }
        
        PrintWriter out = response.getWriter();
        out.println("<h1>æ¬¢è¿ " + escapeHtml(name) + "</h1>");
    }
    
    // é˜²æ­¢XSSæ”»å‡»çš„HTMLè½¬ä¹‰
    private String escapeHtml(String input) {
        if (input == null) return "";
        
        return input.replace("&", "&amp;")
                   .replace("<", "&lt;")
                   .replace(">", "&gt;")
                   .replace("\"", "&quot;")
                   .replace("'", "&#x27;");
    }
}
```

### 6.3 æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜



**ğŸŒ å‰ç«¯å…¼å®¹æ€§å¤„ç†**ï¼š

```jsp
<%-- JSPé¡µé¢çš„å…¼å®¹æ€§å¤„ç† --%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- å“åº”å¼è®¾è®¡ï¼Œå…¼å®¹ç§»åŠ¨è®¾å¤‡ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- IEå…¼å®¹æ¨¡å¼ -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>å…¼å®¹æ€§æµ‹è¯•é¡µé¢</title>
    
    <style>
        /* CSSå…¼å®¹æ€§å¤„ç† */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            
            /* å…¼å®¹è€ç‰ˆæœ¬æµè§ˆå™¨çš„ç›’å­æ¨¡å‹ */
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</h1>
        
        <form action="${pageContext.request.contextPath}/user" method="post">
            <label for="username">ç”¨æˆ·åï¼š</label>
            <input type="text" id="username" name="username" required>
            
            <button type="submit">æäº¤</button>
        </form>
    </div>
    
    <script>
        // JavaScriptå…¼å®¹æ€§å¤„ç†
        (function() {
            // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒæƒ…å†µ
            var browserInfo = {
                name: navigator.appName,
                version: navigator.appVersion,
                userAgent: navigator.userAgent
            };
            
            console.log('æµè§ˆå™¨ä¿¡æ¯:', browserInfo);
            
            // ä¸ºè€ç‰ˆæœ¬IEæ·»åŠ placeholderæ”¯æŒ
            if (!('placeholder' in document.createElement('input'))) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ placeholderçš„polyfill
                console.log('âš ï¸ æµè§ˆå™¨ä¸æ”¯æŒplaceholderå±æ€§');
            }
        })();
    </script>
</body>
</html>
```

---

## 7. ğŸ“‹ æœ€ä½³å®è·µæ€»ç»“



### 7.1 å¼€å‘é˜¶æ®µçš„æœ€ä½³å®è·µ



**ğŸ’¡ é¢„é˜²èƒœäºæ²»ç–—çš„å¼€å‘ä¹ æƒ¯**ï¼š

```java
// âœ… æ ‡å‡†çš„Servletæœ€ä½³å®è·µæ¨¡æ¿
@WebServlet("/best-practice")
public class BestPracticeServlet extends HttpServlet {
    
    private static final Logger logger = LoggerFactory.getLogger(BestPracticeServlet.class);
    
    @Override
    public void init() throws ServletException {
        logger.info("ğŸš€ BestPracticeServlet åˆå§‹åŒ–å®Œæˆ");
    }
    
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        long startTime = System.currentTimeMillis();
        
        try {
            // 1. è®¾ç½®ç¼–ç ï¼ˆæ€»æ˜¯ç¬¬ä¸€æ­¥ï¼‰
            request.setCharacterEncoding("UTF-8");
            response.setContentType("text/html;charset=UTF-8");
            
            // 2. å‚æ•°éªŒè¯
            String userId = validateParameter(request.getParameter("id"), "ç”¨æˆ·ID");
            
            // 3. ä¸šåŠ¡é€»è¾‘å¤„ç†
            processUserRequest(userId, response);
            
        } catch (IllegalArgumentException e) {
            // 4. å‚æ•°é”™è¯¯å¤„ç†
            logger.warn("å‚æ•°éªŒè¯å¤±è´¥: " + e.getMessage());
            sendError(response, 400, "è¯·æ±‚å‚æ•°é”™è¯¯: " + e.getMessage());
            
        } catch (Exception e) {
            // 5. ç³»ç»Ÿé”™è¯¯å¤„ç†
            logger.error("å¤„ç†è¯·æ±‚æ—¶å‡ºé”™", e);
            sendError(response, 500, "ç³»ç»Ÿå†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•");
            
        } finally {
            // 6. æ€§èƒ½ç›‘æ§
            long endTime = System.currentTimeMillis();
            logger.info("è¯·æ±‚å¤„ç†è€—æ—¶: {}ms", (endTime - startTime));
        }
    }
    
    // å‚æ•°éªŒè¯å·¥å…·æ–¹æ³•
    private String validateParameter(String param, String paramName) {
        if (param == null || param.trim().isEmpty()) {
            throw new IllegalArgumentException(paramName + "ä¸èƒ½ä¸ºç©º");
        }
        return param.trim();
    }
    
    // ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
    private void sendError(HttpServletResponse response, int statusCode, String message) 
            throws IOException {
        response.setStatus(statusCode);
        PrintWriter out = response.getWriter();
        out.println("{\"error\": \"" + message + "\"}");
    }
    
    private void processUserRequest(String userId, HttpServletResponse response) 
            throws IOException {
        // å…·ä½“ä¸šåŠ¡é€»è¾‘
        PrintWriter out = response.getWriter();
        out.println("<h1>âœ… è¯·æ±‚å¤„ç†æˆåŠŸ</h1>");
        out.println("<p>ç”¨æˆ·ID: " + escapeHtml(userId) + "</p>");
    }
    
    // HTMLè½¬ä¹‰é˜²æ­¢XSS
    private String escapeHtml(String input) {
        return input.replace("&", "&amp;")
                   .replace("<", "&lt;")
                   .replace(">", "&gt;");
    }
}
```

### 7.2 è¿ç»´å’Œç›‘æ§æœ€ä½³å®è·µ



**ğŸ“Š ç”Ÿäº§ç¯å¢ƒç›‘æ§è¦ç‚¹**ï¼š

| ç›‘æ§é¡¹ç›® | **ç›‘æ§æŒ‡æ ‡** | **å‘Šè­¦é˜ˆå€¼** | **å¤„ç†æ–¹æ³•** |
|---------|------------|------------|------------|
| ğŸƒ **å“åº”æ—¶é—´** | `å¹³å‡å“åº”æ—¶é—´` | `>3ç§’` | `æ£€æŸ¥æ€§èƒ½ç“¶é¢ˆ` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨** | `å †å†…å­˜ä½¿ç”¨ç‡` | `>80%` | `æ£€æŸ¥å†…å­˜æ³„æ¼` |
| ğŸ§µ **çº¿ç¨‹æ•°é‡** | `æ´»è·ƒçº¿ç¨‹æ•°` | `>200` | `æ£€æŸ¥æ­»é”é—®é¢˜` |
| âŒ **é”™è¯¯ç‡** | `5xxé”™è¯¯æ¯”ä¾‹` | `>5%` | `æ£€æŸ¥åº”ç”¨æ—¥å¿—` |

### 7.3 å›¢é˜Ÿåä½œæœ€ä½³å®è·µ



**ğŸ¤ å¼€å‘å›¢é˜Ÿè§„èŒƒå»ºè®®**ï¼š

```
ä»£ç è§„èŒƒï¼š
âœ… ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒ
âœ… æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£
âœ… å®ç°ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†
âœ… éµå¾ªå•ä¸€èŒè´£åŸåˆ™

æµ‹è¯•è§„èŒƒï¼š
âœ… æ¯ä¸ªServletéƒ½è¦æœ‰å•å…ƒæµ‹è¯•
âœ… è¿›è¡Œå¹¶å‘æµ‹è¯•
âœ… æµ‹è¯•å¼‚å¸¸æƒ…å†µå¤„ç†
âœ… éªŒè¯å†…å­˜ä½¿ç”¨æƒ…å†µ

éƒ¨ç½²è§„èŒƒï¼š
âœ… ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†ç¯å¢ƒå·®å¼‚
âœ… å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
âœ… å»ºç«‹å›æ»šæœºåˆ¶
âœ… ç›‘æ§éƒ¨ç½²åçš„åº”ç”¨çŠ¶æ€
```

**ğŸ¯ æŒç»­æ”¹è¿›å»ºè®®**ï¼š

- ğŸ“ˆ **æ€§èƒ½åŸºçº¿**ï¼šå»ºç«‹æ€§èƒ½åŸºå‡†ï¼ŒæŒç»­å¯¹æ¯”
- ğŸ” **æ—¥å¿—åˆ†æ**ï¼šå®šæœŸåˆ†ææ—¥å¿—ï¼Œå‘ç°æ½œåœ¨é—®é¢˜
- ğŸ“š **çŸ¥è¯†åˆ†äº«**ï¼šå›¢é˜Ÿå†…éƒ¨åˆ†äº«é—®é¢˜è§£å†³ç»éªŒ
- ğŸ› ï¸ **å·¥å…·å‡çº§**ï¼šåŠæ—¶æ›´æ–°å¼€å‘å’Œç›‘æ§å·¥å…·

---

# ğŸ’­ æ€»ç»“ä¸æ€è€ƒ



é€šè¿‡å­¦ä¹ è¿™äº›æ€§èƒ½ä¼˜åŒ–å’Œé—®é¢˜è§£å†³æŠ€å·§ï¼Œä½ ç°åœ¨åº”è¯¥èƒ½å¤Ÿï¼š

ğŸ¯ **æŒæ¡çš„æ ¸å¿ƒæŠ€èƒ½**ï¼š
- ğŸ” è¯†åˆ«å’Œè§£å†³å†…å­˜æ³„æ¼é—®é¢˜
- ğŸ“ˆ å®šä½æ€§èƒ½ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–
- ğŸ§µ å¤„ç†å¹¶å‘é—®é¢˜å’Œçº¿ç¨‹å®‰å…¨
- âš™ï¸ å¿«é€Ÿå®šä½å’Œä¿®å¤é…ç½®é”™è¯¯
- ğŸš€ è§£å†³éƒ¨ç½²å’Œç¯å¢ƒå…¼å®¹æ€§é—®é¢˜

ğŸš€ **ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®**ï¼š
1. **æ·±å…¥JVMè°ƒä¼˜**ï¼šå­¦ä¹ åƒåœ¾å›æ”¶å’Œå†…å­˜ç®¡ç†
2. **æŒæ¡åˆ†å¸ƒå¼æ¶æ„**ï¼šå¾®æœåŠ¡å’Œé›†ç¾¤éƒ¨ç½²
3. **å­¦ä¹ DevOpså®è·µ**ï¼šè‡ªåŠ¨åŒ–è¿ç»´å’Œç›‘æ§
4. **æå‡å®‰å…¨æ„è¯†**ï¼šWebåº”ç”¨å®‰å…¨é˜²æŠ¤

è®°ä½ï¼š**é—®é¢˜è§£å†³èƒ½åŠ›æ˜¯ç¨‹åºå‘˜æœ€é‡è¦çš„æŠ€èƒ½ä¹‹ä¸€**ã€‚é‡åˆ°é—®é¢˜ä¸è¦æ…Œå¼ ï¼ŒæŒ‰ç…§ç³»ç»Ÿçš„æ–¹æ³•é€æ­¥åˆ†æå’Œè§£å†³ï¼Œç§¯ç´¯ç»éªŒåä½ ä¼šå‘ç°å¤§å¤šæ•°é—®é¢˜éƒ½æœ‰è§„å¾‹å¯å¾ªï¼