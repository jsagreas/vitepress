---
title: 4ã€ä¼šè¯ç»¼åˆåº”ç”¨
---
## ğŸ“š ç›®å½•

1. [ä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-ä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [ç”¨æˆ·ç™»å½•çŠ¶æ€ä¿æŒ](#2-ç”¨æˆ·ç™»å½•çŠ¶æ€ä¿æŒ)
3. [è´­ç‰©è½¦åŠŸèƒ½å®ç°](#3-è´­ç‰©è½¦åŠŸèƒ½å®ç°)
4. [Sessionä¸Cookieç»“åˆä½¿ç”¨](#4-Sessionä¸Cookieç»“åˆä½¿ç”¨)
5. [ä¼šè¯å®‰å…¨é˜²æŠ¤](#5-ä¼šè¯å®‰å…¨é˜²æŠ¤)
6. [åˆ†å¸ƒå¼ä¼šè¯å¤„ç†](#6-åˆ†å¸ƒå¼ä¼šè¯å¤„ç†)
7. [Sessioné›†ç¾¤åŒæ­¥](#7-Sessioné›†ç¾¤åŒæ­¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’¡ ä¼šè¯ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ä¼šè¯ç®¡ç†


**ğŸ”¸ é€šä¿—ç†è§£**
æŠŠä¼šè¯ç®¡ç†æƒ³è±¡æˆ**é¤å…çš„å·ç ç‰Œç³»ç»Ÿ**ï¼š
- ä½ åˆ°é¤å…å–å·ï¼ŒæœåŠ¡å‘˜ç»™ä½ ä¸€ä¸ªå·ç ç‰Œï¼ˆç±»ä¼¼SessionIDï¼‰
- é¤å…è®°å½•ä½ çš„ä¿¡æ¯ï¼šç‚¹äº†ä»€ä¹ˆèœã€åå“ªæ¡Œã€ä»€ä¹ˆæ—¶é—´æ¥çš„ï¼ˆç±»ä¼¼Sessionæ•°æ®ï¼‰
- ä¸‹æ¬¡ä½ æ‹¿å·ç ç‰Œæ¥ï¼ŒæœåŠ¡å‘˜å°±çŸ¥é“ä½ æ˜¯è°ï¼Œä¸ºä½ æä¾›å¯¹åº”æœåŠ¡
- ç¦»å¼€é¤å…æ—¶å½’è¿˜å·ç ç‰Œï¼ˆSessionå¤±æ•ˆï¼‰

**ğŸ”¸ æŠ€æœ¯å®šä¹‰**
ä¼šè¯ç®¡ç†æ˜¯Webåº”ç”¨ä¸­**è·Ÿè¸ªç”¨æˆ·çŠ¶æ€**çš„æŠ€æœ¯ï¼Œè§£å†³HTTPæ— çŠ¶æ€åè®®çš„é—®é¢˜ã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯ç®¡ç†


**HTTPåè®®çš„"å¥å¿˜ç—‡"é—®é¢˜ï¼š**
```
ç”¨æˆ·è®¿é—®æµç¨‹ï¼š
ç¬¬1æ¬¡è¯·æ±‚ï¼šç™»å½•é¡µé¢ â†’ æœåŠ¡å™¨ä¸è®¤è¯†ä½ 
ç¬¬2æ¬¡è¯·æ±‚ï¼šæäº¤ç”¨æˆ·åå¯†ç  â†’ æœåŠ¡å™¨éªŒè¯é€šè¿‡
ç¬¬3æ¬¡è¯·æ±‚ï¼šè®¿é—®ä¸ªäººä¸­å¿ƒ â†’ æœåŠ¡å™¨åˆä¸è®¤è¯†ä½ äº†ï¼

é—®é¢˜ï¼šæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæœåŠ¡å™¨æ— æ³•è®°ä½ç”¨æˆ·èº«ä»½
```

**ç°å®åº”ç”¨åœºæ™¯ï¼š**
- ğŸ›’ **è´­ç‰©è½¦**ï¼šæ·»åŠ å•†å“åï¼Œæ¢ä¸ªé¡µé¢å•†å“è¿˜åœ¨
- ğŸ‘¤ **ç”¨æˆ·ç™»å½•**ï¼šç™»å½•åè®¿é—®å…¶ä»–é¡µé¢æ— éœ€é‡æ–°ç™»å½•
- ğŸ¯ **ä¸ªæ€§åŒ–æ¨è**ï¼šæ ¹æ®ç”¨æˆ·æµè§ˆè®°å½•æ¨èå†…å®¹
- ğŸ“Š **ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ª**ï¼šç»Ÿè®¡ç”¨æˆ·åœ¨ç½‘ç«™çš„æ“ä½œè½¨è¿¹

### 1.3 ä¼šè¯ç®¡ç†æŠ€æœ¯å¯¹æ¯”


| æŠ€æœ¯æ–¹æ¡ˆ | **å­˜å‚¨ä½ç½®** | **å®¹é‡é™åˆ¶** | **å®‰å…¨æ€§** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|-------------|-----------|-------------|
| ğŸª **Cookie** | `å®¢æˆ·ç«¯æµè§ˆå™¨` | `4KB` | `è¾ƒä½` | `ç®€å•æ•°æ®ï¼Œå¦‚ç”¨æˆ·åå¥½` |
| ğŸ“¦ **Session** | `æœåŠ¡å™¨å†…å­˜` | `æ— æ˜æ˜¾é™åˆ¶` | `è¾ƒé«˜` | `æ•æ„Ÿæ•°æ®ï¼Œå¦‚ç™»å½•çŠ¶æ€` |
| ğŸŒ **localStorage** | `å®¢æˆ·ç«¯æµè§ˆå™¨` | `5-10MB` | `ä½` | `ç¦»çº¿æ•°æ®å­˜å‚¨` |
| ğŸ”„ **URLé‡å†™** | `URLå‚æ•°` | `URLé•¿åº¦é™åˆ¶` | `æœ€ä½` | `ç‰¹æ®Šæƒ…å†µä¸‹çš„å¤‡ç”¨æ–¹æ¡ˆ` |

---

## 2. ğŸ” ç”¨æˆ·ç™»å½•çŠ¶æ€ä¿æŒ


### 2.1 ç™»å½•çŠ¶æ€ä¿æŒçš„å·¥ä½œåŸç†


**ğŸ”„ å®Œæ•´ç™»å½•æµç¨‹å›¾ï¼š**
```
ç”¨æˆ·                    æœåŠ¡å™¨                   æ•°æ®åº“
 â”‚                       â”‚                       â”‚
 â”‚â”€â”€[1]è®¿é—®ç™»å½•é¡µâ”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                       â”‚
 â”‚â†â”€[2]è¿”å›ç™»å½•è¡¨å•â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
 â”‚                       â”‚                       â”‚
 â”‚â”€â”€[3]æäº¤ç”¨æˆ·åå¯†ç â”€â”€â”€â”€â”€â†’â”‚                       â”‚
 â”‚                       â”‚â”€â”€[4]éªŒè¯ç”¨æˆ·ä¿¡æ¯â”€â”€â”€â”€â”€â†’â”‚
 â”‚                       â”‚â†â”€[5]è¿”å›éªŒè¯ç»“æœâ”€â”€â”€â”€â”€â”€â”‚
 â”‚                       â”‚                       â”‚
 â”‚â†â”€[6]è®¾ç½®Sessionâ”€â”€â”€â”€â”€â”€â”€â”€â”‚åˆ›å»ºSessionå¯¹è±¡         â”‚
 â”‚   è¿”å›SessionID        â”‚å­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯        â”‚
 â”‚                       â”‚                       â”‚
 â”‚â”€â”€[7]è®¿é—®å—ä¿æŠ¤é¡µé¢â”€â”€â”€â”€â†’â”‚                       â”‚
 â”‚   æºå¸¦SessionID        â”‚æ£€æŸ¥Sessionæ˜¯å¦å­˜åœ¨     â”‚
 â”‚â†â”€[8]è¿”å›é¡µé¢å†…å®¹â”€â”€â”€â”€â”€â”€â”€â”‚éªŒè¯ç™»å½•çŠ¶æ€           â”‚
```

### 2.2 ç™»å½•åŠŸèƒ½æ ¸å¿ƒä»£ç å®ç°


**ç™»å½•éªŒè¯Servletï¼š**
```java
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // è·å–ç”¨æˆ·è¾“å…¥
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        
        // éªŒè¯ç”¨æˆ·ä¿¡æ¯ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        if (validateUser(username, password)) {
            // åˆ›å»ºSession
            HttpSession session = request.getSession();
            
            // å­˜å‚¨ç”¨æˆ·ä¿¡æ¯åˆ°Session
            session.setAttribute("username", username);
            session.setAttribute("loginTime", new Date());
            session.setAttribute("isLoggedIn", true);
            
            // è·³è½¬åˆ°é¦–é¡µ
            response.sendRedirect("index.jsp");
        } else {
            // ç™»å½•å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯
            request.setAttribute("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            request.getRequestDispatcher("login.jsp").forward(request, response);
        }
    }
}
```

**ç™»å½•çŠ¶æ€æ£€æŸ¥è¿‡æ»¤å™¨ï¼š**
```java
@WebFilter("/*")
public class LoginFilter implements Filter {
    
    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) 
            throws IOException, ServletException {
        
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) resp;
        
        String path = request.getRequestURI();
        
        // ä¸éœ€è¦ç™»å½•çš„é¡µé¢
        if (path.contains("login") || path.contains("register") || 
            path.endsWith(".css") || path.endsWith(".js")) {
            chain.doFilter(request, response);
            return;
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        HttpSession session = request.getSession(false);
        if (session != null && session.getAttribute("isLoggedIn") != null) {
            // å·²ç™»å½•ï¼Œç»§ç»­è®¿é—®
            chain.doFilter(request, response);
        } else {
            // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µ
            response.sendRedirect("login.jsp");
        }
    }
}
```

### 2.3 ç™»å½•çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†


**ğŸ•’ Sessionè¶…æ—¶å¤„ç†ï¼š**
```java
// web.xmlä¸­è®¾ç½®Sessionè¶…æ—¶æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
<session-config>
    <session-timeout>30</session-timeout>
</session-config>

// ä»£ç ä¸­åŠ¨æ€è®¾ç½®
HttpSession session = request.getSession();
session.setMaxInactiveInterval(30 * 60); // 30åˆ†é’Ÿ
```

**é€€å‡ºç™»å½•å¤„ç†ï¼š**
```java
@WebServlet("/logout")
public class LogoutServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        HttpSession session = request.getSession(false);
        if (session != null) {
            // æ¸…é™¤Sessionæ•°æ®
            session.invalidate();
        }
        
        // è·³è½¬åˆ°ç™»å½•é¡µ
        response.sendRedirect("login.jsp");
    }
}
```

---

## 3. ğŸ›’ è´­ç‰©è½¦åŠŸèƒ½å®ç°


### 3.1 è´­ç‰©è½¦çš„æ•°æ®ç»“æ„è®¾è®¡


**ğŸ¯ è´­ç‰©è½¦è¦è§£å†³çš„é—®é¢˜ï¼š**
- ç”¨æˆ·å¯ä»¥æ·»åŠ å¤šç§å•†å“
- æ¯ç§å•†å“å¯ä»¥æœ‰ä¸åŒæ•°é‡
- ç”¨æˆ·å¯ä»¥ä¿®æ”¹å•†å“æ•°é‡
- ç”¨æˆ·å¯ä»¥åˆ é™¤å•†å“
- è®¡ç®—æ€»ä»·æ ¼

**è´­ç‰©è½¦å•†å“ç±»ï¼š**
```java
public class CartItem {
    private String productId;      // å•†å“ID
    private String productName;    // å•†å“åç§°
    private double price;          // å•†å“å•ä»·
    private int quantity;          // å•†å“æ•°é‡
    
    // è®¡ç®—è¯¥å•†å“çš„å°è®¡
    public double getSubtotal() {
        return price * quantity;
    }
    
    // getterå’Œsetteræ–¹æ³•...
}
```

**è´­ç‰©è½¦ç®¡ç†ç±»ï¼š**
```java
public class ShoppingCart {
    // ä½¿ç”¨Mapå­˜å‚¨è´­ç‰©è½¦å•†å“ï¼Œkeyæ˜¯å•†å“IDï¼Œvalueæ˜¯å•†å“ä¿¡æ¯
    private Map<String, CartItem> items = new HashMap<>();
    
    // æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
    public void addItem(String productId, String productName, double price, int quantity) {
        if (items.containsKey(productId)) {
            // å¦‚æœå•†å“å·²å­˜åœ¨ï¼Œå¢åŠ æ•°é‡
            CartItem item = items.get(productId);
            item.setQuantity(item.getQuantity() + quantity);
        } else {
            // æ–°å•†å“ï¼Œç›´æ¥æ·»åŠ 
            CartItem item = new CartItem(productId, productName, price, quantity);
            items.put(productId, item);
        }
    }
    
    // è®¡ç®—è´­ç‰©è½¦æ€»ä»·
    public double getTotalPrice() {
        return items.values().stream()
                   .mapToDouble(CartItem::getSubtotal)
                   .sum();
    }
    
    // è·å–è´­ç‰©è½¦æ‰€æœ‰å•†å“
    public Collection<CartItem> getAllItems() {
        return items.values();
    }
}
```

### 3.2 è´­ç‰©è½¦æ“ä½œå®ç°


**æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ï¼š**
```java
@WebServlet("/addToCart")
public class AddToCartServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // è·å–å•†å“ä¿¡æ¯
        String productId = request.getParameter("productId");
        String productName = request.getParameter("productName");
        double price = Double.parseDouble(request.getParameter("price"));
        int quantity = Integer.parseInt(request.getParameter("quantity"));
        
        // è·å–Sessionä¸­çš„è´­ç‰©è½¦
        HttpSession session = request.getSession();
        ShoppingCart cart = (ShoppingCart) session.getAttribute("cart");
        
        // å¦‚æœè´­ç‰©è½¦ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„è´­ç‰©è½¦
        if (cart == null) {
            cart = new ShoppingCart();
            session.setAttribute("cart", cart);
        }
        
        // æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
        cart.addItem(productId, productName, price, quantity);
        
        // è¿”å›JSONå“åº”
        response.setContentType("application/json");
        response.getWriter().write("{\"success\": true, \"message\": \"å•†å“å·²æ·»åŠ åˆ°è´­ç‰©è½¦\"}");
    }
}
```

**è´­ç‰©è½¦é¡µé¢å±•ç¤ºï¼š**
```java
@WebServlet("/cart")
public class CartServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        HttpSession session = request.getSession();
        ShoppingCart cart = (ShoppingCart) session.getAttribute("cart");
        
        if (cart == null) {
            cart = new ShoppingCart(); // åˆ›å»ºç©ºè´­ç‰©è½¦
        }
        
        // å°†è´­ç‰©è½¦æ•°æ®ä¼ é€’ç»™JSP
        request.setAttribute("cartItems", cart.getAllItems());
        request.setAttribute("totalPrice", cart.getTotalPrice());
        
        request.getRequestDispatcher("cart.jsp").forward(request, response);
    }
}
```

### 3.3 è´­ç‰©è½¦çš„æŒä¹…åŒ–ç­–ç•¥


**ğŸ”¸ ä¸åŒæŒä¹…åŒ–æ–¹æ¡ˆå¯¹æ¯”ï¼š**

```
Sessionå­˜å‚¨ï¼ˆé€‚åˆå°è§„æ¨¡åº”ç”¨ï¼‰ï¼š
ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç”¨æˆ·ä½“éªŒå¥½
ç¼ºç‚¹ï¼šæœåŠ¡å™¨é‡å¯ä¸¢å¤±ï¼Œå ç”¨æœåŠ¡å™¨å†…å­˜

Cookieå­˜å‚¨ï¼ˆé€‚åˆç®€å•è´­ç‰©è½¦ï¼‰ï¼š
ä¼˜ç‚¹ï¼šä¸å ç”¨æœåŠ¡å™¨èµ„æº
ç¼ºç‚¹ï¼šå®¹é‡é™åˆ¶4KBï¼Œå®‰å…¨æ€§è¾ƒä½

æ•°æ®åº“å­˜å‚¨ï¼ˆé€‚åˆä¼ä¸šçº§åº”ç”¨ï¼‰ï¼š
ä¼˜ç‚¹ï¼šæŒä¹…åŒ–ï¼Œæ”¯æŒå¤šè®¾å¤‡åŒæ­¥
ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œéœ€è¦å¤„ç†ç™»å½•çŠ¶æ€
```

---

## 4. ğŸ”„ Sessionä¸Cookieç»“åˆä½¿ç”¨


### 4.1 ç»“åˆä½¿ç”¨çš„å…¸å‹åœºæ™¯


**ğŸ¯ "è®°ä½æˆ‘"åŠŸèƒ½å®ç°åŸç†ï¼š**

```
ç”¨æˆ·ç™»å½•æµç¨‹ï¼š
1. ç”¨æˆ·å‹¾é€‰"è®°ä½æˆ‘"é€‰é¡¹ç™»å½•
2. æœåŠ¡å™¨éªŒè¯æˆåŠŸåï¼š
   - åˆ›å»ºSessionå­˜å‚¨ç™»å½•çŠ¶æ€ï¼ˆçŸ­æœŸæœ‰æ•ˆï¼‰
   - è®¾ç½®Cookieå­˜å‚¨ç™»å½•å‡­è¯ï¼ˆé•¿æœŸæœ‰æ•ˆï¼‰
3. Sessionè¿‡æœŸåï¼ŒCookieä»ç„¶æœ‰æ•ˆ
4. ä¸‹æ¬¡è®¿é—®æ—¶ï¼ŒæœåŠ¡å™¨æ£€æŸ¥Cookieè‡ªåŠ¨ç™»å½•
```

**"è®°ä½æˆ‘"åŠŸèƒ½å®ç°ï¼š**
```java
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        String rememberMe = request.getParameter("rememberMe");
        
        if (validateUser(username, password)) {
            // åˆ›å»ºSession
            HttpSession session = request.getSession();
            session.setAttribute("username", username);
            
            // å¦‚æœå‹¾é€‰äº†"è®°ä½æˆ‘"
            if ("on".equals(rememberMe)) {
                // ç”Ÿæˆéšæœºtoken
                String token = generateToken();
                
                // å­˜å‚¨åˆ°æ•°æ®åº“ï¼šç”¨æˆ·å - token æ˜ å°„å…³ç³»
                saveUserToken(username, token);
                
                // è®¾ç½®Cookieï¼Œæœ‰æ•ˆæœŸ7å¤©
                Cookie cookie = new Cookie("remember_token", token);
                cookie.setMaxAge(7 * 24 * 60 * 60); // 7å¤©
                cookie.setPath("/");
                response.addCookie(cookie);
            }
            
            response.sendRedirect("index.jsp");
        }
    }
}
```

**è‡ªåŠ¨ç™»å½•è¿‡æ»¤å™¨ï¼š**
```java
public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) 
        throws IOException, ServletException {
    
    HttpServletRequest request = (HttpServletRequest) req;
    HttpSession session = request.getSession(false);
    
    // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
    if (session != null && session.getAttribute("username") != null) {
        chain.doFilter(req, resp);
        return;
    }
    
    // æ£€æŸ¥è®°ä½æˆ‘Cookie
    Cookie[] cookies = request.getCookies();
    if (cookies != null) {
        for (Cookie cookie : cookies) {
            if ("remember_token".equals(cookie.getName())) {
                String token = cookie.getValue();
                String username = getUserByToken(token);
                
                if (username != null) {
                    // è‡ªåŠ¨ç™»å½•ï¼šåˆ›å»ºæ–°çš„Session
                    HttpSession newSession = request.getSession();
                    newSession.setAttribute("username", username);
                    break;
                }
            }
        }
    }
    
    chain.doFilter(req, resp);
}
```

### 4.2 ç”¨æˆ·åå¥½è®¾ç½®ä¿å­˜


**ä¿å­˜ç”¨æˆ·ç•Œé¢åå¥½ï¼š**
```java
// ä¿å­˜ç”¨æˆ·çš„è¯­è¨€åå¥½
Cookie langCookie = new Cookie("user_language", "zh_CN");
langCookie.setMaxAge(30 * 24 * 60 * 60); // 30å¤©
response.addCookie(langCookie);

// ä¿å­˜ç”¨æˆ·çš„ä¸»é¢˜åå¥½
Cookie themeCookie = new Cookie("user_theme", "dark");
themeCookie.setMaxAge(365 * 24 * 60 * 60); // 1å¹´
response.addCookie(themeCookie);
```

---

## 5. ğŸ›¡ï¸ ä¼šè¯å®‰å…¨é˜²æŠ¤


### 5.1 ä¼šè¯åŠ«æŒæ”»å‡»ä¸é˜²æŠ¤


**ğŸš¨ ä¼šè¯åŠ«æŒçš„å±é™©æ€§ï¼š**
```
æ”»å‡»åœºæ™¯ï¼š
1. ç”¨æˆ·åœ¨å’–å•¡å…ä½¿ç”¨å…¬å…±WiFiä¸Šç½‘
2. é»‘å®¢é€šè¿‡ç½‘ç»œå—…æ¢è·å–ç”¨æˆ·çš„SessionID
3. é»‘å®¢ä½¿ç”¨æˆªè·çš„SessionIDå†’å……ç”¨æˆ·èº«ä»½
4. é»‘å®¢å¯ä»¥ä»¥ç”¨æˆ·èº«ä»½è¿›è¡Œä»»ä½•æ“ä½œ

åæœï¼šè´¦æˆ·è¢«ç›—ç”¨ï¼Œä¸ªäººä¿¡æ¯æ³„éœ²ï¼Œè´¢äº§æŸå¤±
```

**é˜²æŠ¤æªæ–½1ï¼šHTTPSåŠ å¯†ä¼ è¾“**
```java
// å¼ºåˆ¶ä½¿ç”¨HTTPS
if (!request.isSecure()) {
    String httpsURL = "https://" + request.getServerName() + 
                     request.getRequestURI();
    response.sendRedirect(httpsURL);
    return;
}
```

**é˜²æŠ¤æªæ–½2ï¼šSession IDé‡æ–°ç”Ÿæˆ**
```java
// ç™»å½•æˆåŠŸåé‡æ–°ç”ŸæˆSessionID
HttpSession oldSession = request.getSession(false);
if (oldSession != null) {
    oldSession.invalidate(); // é”€æ¯æ—§Session
}

HttpSession newSession = request.getSession(true); // åˆ›å»ºæ–°Session
newSession.setAttribute("username", username);
```

**é˜²æŠ¤æªæ–½3ï¼šIPåœ°å€ç»‘å®šæ£€æŸ¥**
```java
public class SecurityFilter implements Filter {
    
    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) 
            throws IOException, ServletException {
        
        HttpServletRequest request = (HttpServletRequest) req;
        HttpSession session = request.getSession(false);
        
        if (session != null) {
            String sessionIP = (String) session.getAttribute("user_ip");
            String currentIP = request.getRemoteAddr();
            
            if (sessionIP == null) {
                // é¦–æ¬¡è®¿é—®ï¼Œè®°å½•IP
                session.setAttribute("user_ip", currentIP);
            } else if (!sessionIP.equals(currentIP)) {
                // IPåœ°å€å˜åŒ–ï¼Œå¯èƒ½è¢«åŠ«æŒ
                session.invalidate();
                response.sendRedirect("login.jsp?error=security");
                return;
            }
        }
        
        chain.doFilter(req, resp);
    }
}
```

### 5.2 CSRFæ”»å‡»é˜²æŠ¤


**ğŸ”¸ CSRFæ”»å‡»åŸç†ï¼š**
è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼Œåˆ©ç”¨ç”¨æˆ·å·²ç™»å½•çš„èº«ä»½æ‰§è¡Œæ¶æ„æ“ä½œã€‚

**é˜²æŠ¤æªæ–½ï¼šTokenéªŒè¯**
```java
// ç”ŸæˆCSRF Token
public String generateCSRFToken() {
    return UUID.randomUUID().toString();
}

// åœ¨è¡¨å•ä¸­æ·»åŠ éšè—çš„Token
<input type="hidden" name="csrf_token" value="${sessionScope.csrf_token}">

// éªŒè¯Token
String sessionToken = (String) session.getAttribute("csrf_token");
String requestToken = request.getParameter("csrf_token");

if (sessionToken == null || !sessionToken.equals(requestToken)) {
    throw new SecurityException("CSRF TokenéªŒè¯å¤±è´¥");
}
```

### 5.3 Sessionå®‰å…¨é…ç½®


**web.xmlå®‰å…¨é…ç½®ï¼š**
```xml
<session-config>
    <!-- Sessionè¶…æ—¶æ—¶é—´ -->
    <session-timeout>30</session-timeout>
    
    <!-- Cookieå®‰å…¨é…ç½® -->
    <cookie-config>
        <!-- åªèƒ½é€šè¿‡HTTPè®¿é—®ï¼Œé˜²æ­¢XSSæ”»å‡» -->
        <http-only>true</http-only>
        <!-- åªåœ¨HTTPSä¸‹ä¼ è¾“ -->
        <secure>true</secure>
        <!-- SameSiteå±æ€§é˜²æ­¢CSRF -->
        <same-site>Strict</same-site>
    </cookie-config>
</session-config>
```

---

## 6. ğŸŒ åˆ†å¸ƒå¼ä¼šè¯å¤„ç†


### 6.1 åˆ†å¸ƒå¼ç¯å¢ƒçš„ä¼šè¯é—®é¢˜


**ğŸ”¸ é—®é¢˜æè¿°ï¼š**
```
å•æœåŠ¡å™¨ç¯å¢ƒï¼š
ç”¨æˆ· â†’ æœåŠ¡å™¨A â†’ Sessionå­˜åœ¨æœåŠ¡å™¨Aå†…å­˜ä¸­ âœ…

åˆ†å¸ƒå¼ç¯å¢ƒï¼š
ç”¨æˆ·ç¬¬1æ¬¡è¯·æ±‚ â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ æœåŠ¡å™¨A ï¼ˆåˆ›å»ºSessionï¼‰
ç”¨æˆ·ç¬¬2æ¬¡è¯·æ±‚ â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ æœåŠ¡å™¨B ï¼ˆæ‰¾ä¸åˆ°Sessionï¼‰âŒ

é—®é¢˜ï¼šç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•ï¼Œä½“éªŒæå·®ï¼
```

**åˆ†å¸ƒå¼ä¼šè¯è§£å†³æ–¹æ¡ˆå¯¹æ¯”ï¼š**

| æ–¹æ¡ˆ | **åŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|---------|-------------|
| ğŸ”’ **Sessionç²˜æ»** | `è´Ÿè½½å‡è¡¡å™¨ç»‘å®šç”¨æˆ·åˆ°å›ºå®šæœåŠ¡å™¨` | `å®ç°ç®€å•` | `è´Ÿè½½ä¸å‡è¡¡ï¼Œå®¹é”™æ€§å·®` | `å°è§„æ¨¡åº”ç”¨` |
| ğŸ”„ **Sessionå¤åˆ¶** | `æ‰€æœ‰æœåŠ¡å™¨åŒæ­¥Sessionæ•°æ®` | `å®¹é”™æ€§å¥½` | `ç½‘ç»œå¼€é”€å¤§ï¼Œä¸é€‚åˆå¤§é›†ç¾¤` | `ä¸­å°è§„æ¨¡é›†ç¾¤` |
| ğŸ—„ï¸ **Sessionå¤–éƒ¨å­˜å‚¨** | `Sessionå­˜å‚¨åœ¨Redisç­‰å¤–éƒ¨ç³»ç»Ÿ` | `æ‰©å±•æ€§å¥½ï¼Œæ€§èƒ½é«˜` | `å¢åŠ ç³»ç»Ÿå¤æ‚åº¦` | `å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ` |

### 6.2 Rediså…±äº«Sessionå®ç°


**ğŸ”§ Redis Sessionå­˜å‚¨æ¶æ„ï¼š**
```
ç”¨æˆ·è¯·æ±‚ â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ æœåŠ¡å™¨A/B/C
                            â†“
                        RedisæœåŠ¡å™¨
                    ï¼ˆå…±äº«Sessionå­˜å‚¨ï¼‰
                    
æ‰€æœ‰æœåŠ¡å™¨éƒ½ä»Redisè¯»å†™Sessionæ•°æ®
```

**Mavenä¾èµ–é…ç½®ï¼š**
```xml
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
    <version>3.7.0</version>
</dependency>
```

**Redis Sessionå·¥å…·ç±»ï¼š**
```java
public class RedisSessionUtil {
    private static JedisPool jedisPool;
    
    static {
        JedisPoolConfig config = new JedisPoolConfig();
        jedisPool = new JedisPool(config, "localhost", 6379);
    }
    
    // å­˜å‚¨Sessionæ•°æ®
    public static void setSession(String sessionId, String key, Object value) {
        try (Jedis jedis = jedisPool.getResource()) {
            String sessionKey = "session:" + sessionId;
            jedis.hset(sessionKey, key, serialize(value));
            jedis.expire(sessionKey, 1800); // 30åˆ†é’Ÿè¿‡æœŸ
        }
    }
    
    // è·å–Sessionæ•°æ®
    public static Object getSession(String sessionId, String key) {
        try (Jedis jedis = jedisPool.getResource()) {
            String sessionKey = "session:" + sessionId;
            String value = jedis.hget(sessionKey, key);
            return deserialize(value);
        }
    }
    
    // åˆ é™¤Session
    public static void removeSession(String sessionId) {
        try (Jedis jedis = jedisPool.getResource()) {
            String sessionKey = "session:" + sessionId;
            jedis.del(sessionKey);
        }
    }
}
```

**è‡ªå®šä¹‰Sessionç®¡ç†å™¨ï¼š**
```java
public class DistributedSession {
    private String sessionId;
    private boolean isNew = false;
    
    public DistributedSession(String sessionId) {
        this.sessionId = sessionId;
    }
    
    public void setAttribute(String name, Object value) {
        RedisSessionUtil.setSession(sessionId, name, value);
    }
    
    public Object getAttribute(String name) {
        return RedisSessionUtil.getSession(sessionId, name);
    }
    
    public void invalidate() {
        RedisSessionUtil.removeSession(sessionId);
    }
}
```

---

## 7. ğŸ”„ Sessioné›†ç¾¤åŒæ­¥


### 7.1 Sessionå¤åˆ¶æœºåˆ¶


**ğŸ”„ Sessionå¤åˆ¶å·¥ä½œåŸç†ï¼š**
```
æœåŠ¡å™¨é›†ç¾¤çŠ¶æ€åŒæ­¥ï¼š

æœåŠ¡å™¨A        æœåŠ¡å™¨B        æœåŠ¡å™¨C
Session1   â†’   Session1   â†’   Session1
Session2   â†’   Session2   â†’   Session2  
Session3   â†’   Session3   â†’   Session3

æ¯ä¸ªæœåŠ¡å™¨éƒ½ä¿å­˜æ‰€æœ‰ç”¨æˆ·çš„Sessionæ•°æ®
```

**Tomcaté›†ç¾¤Sessionå¤åˆ¶é…ç½®ï¼š**
```xml
<!-- server.xmlä¸­é…ç½® -->
<Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster">
    <!-- é›†ç¾¤ç®¡ç†å™¨ -->
    <Manager className="org.apache.catalina.ha.session.DeltaManager"
             expireSessionsOnShutdown="false"
             notifyListenersOnReplication="true"/>
    
    <!-- ç»„æ’­é…ç½® -->
    <Channel className="org.apache.catalina.tribes.group.GroupChannel">
        <Membership className="org.apache.catalina.tribes.membership.McastService"
                    address="228.0.0.4"
                    port="45564"/>
    </Channel>
</Cluster>
```

### 7.2 æ•°æ®åº“Sessionå­˜å‚¨


**æ•°æ®åº“Sessionè¡¨è®¾è®¡ï¼š**
```sql
CREATE TABLE sessions (
    session_id VARCHAR(100) PRIMARY KEY,
    user_id VARCHAR(50),
    session_data TEXT,
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_accessed TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    max_inactive_interval INT DEFAULT 1800
);
```

**æ•°æ®åº“Sessionæ“ä½œï¼š**
```java
public class DatabaseSessionManager {
    
    public void saveSession(String sessionId, Map<String, Object> sessionData) {
        String sql = "INSERT INTO sessions (session_id, session_data) VALUES (?, ?) " +
                    "ON DUPLICATE KEY UPDATE session_data = ?, last_accessed = NOW()";
        
        try (Connection conn = getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {
            
            String jsonData = convertToJson(sessionData);
            stmt.setString(1, sessionId);
            stmt.setString(2, jsonData);
            stmt.setString(3, jsonData);
            stmt.executeUpdate();
        }
    }
    
    public Map<String, Object> loadSession(String sessionId) {
        String sql = "SELECT session_data FROM sessions WHERE session_id = ? " +
                    "AND last_accessed > DATE_SUB(NOW(), INTERVAL max_inactive_interval SECOND)";
        
        try (Connection conn = getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {
            
            stmt.setString(1, sessionId);
            ResultSet rs = stmt.executeQuery();
            
            if (rs.next()) {
                String jsonData = rs.getString("session_data");
                return convertFromJson(jsonData);
            }
        }
        return null;
    }
}
```

### 7.3 SessionåŒæ­¥æ€§èƒ½ä¼˜åŒ–


**ğŸš€ ä¼˜åŒ–ç­–ç•¥ï¼š**

```
1. å»¶è¿ŸåŒæ­¥ï¼š
   - æ‰¹é‡åŒæ­¥Sessionå˜æ›´
   - å‡å°‘ç½‘ç»œé€šä¿¡æ¬¡æ•°

2. å¢é‡åŒæ­¥ï¼š
   - åªåŒæ­¥å˜åŒ–çš„Sessionæ•°æ®
   - ä½¿ç”¨æ—¶é—´æˆ³æˆ–ç‰ˆæœ¬å·æ ‡è¯†

3. åˆ†åŒºå­˜å‚¨ï¼š
   - æ ¹æ®ç”¨æˆ·IDåˆ†ç‰‡å­˜å‚¨
   - å‡å°‘å•ä¸ªèŠ‚ç‚¹å‹åŠ›

4. ç¼“å­˜ç­–ç•¥ï¼š
   - æœ¬åœ°ç¼“å­˜ + è¿œç¨‹åŒæ­¥
   - æé«˜è¯»å–æ€§èƒ½
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¼šè¯ç®¡ç†æœ¬è´¨ï¼šè§£å†³HTTPæ— çŠ¶æ€åè®®é—®é¢˜ï¼Œè·Ÿè¸ªç”¨æˆ·çŠ¶æ€
ğŸ”¸ Sessionä¸Cookieï¼šæœåŠ¡å™¨ç«¯å­˜å‚¨ vs å®¢æˆ·ç«¯å­˜å‚¨çš„é…åˆä½¿ç”¨  
ğŸ”¸ ç™»å½•çŠ¶æ€ä¿æŒï¼šSessionå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œè¿‡æ»¤å™¨éªŒè¯è®¿é—®æƒé™
ğŸ”¸ è´­ç‰©è½¦å®ç°ï¼šSessionå­˜å‚¨è´­ç‰©æ•°æ®ï¼Œæ”¯æŒè·¨é¡µé¢æ“ä½œ
ğŸ”¸ å®‰å…¨é˜²æŠ¤ï¼šé˜²æ­¢ä¼šè¯åŠ«æŒã€CSRFæ”»å‡»ï¼Œä¿æŠ¤ç”¨æˆ·æ•°æ®å®‰å…¨
ğŸ”¸ åˆ†å¸ƒå¼å¤„ç†ï¼šè§£å†³é›†ç¾¤ç¯å¢ƒä¸‹çš„Sessionå…±äº«é—®é¢˜
```

### 8.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ ä¼šè¯ç®¡ç†æœ€ä½³å®è·µ**
```
å®‰å…¨æ€§åŸåˆ™ï¼š
â€¢ æ•æ„Ÿæ•°æ®å­˜å‚¨åœ¨Sessionä¸­
â€¢ ä½¿ç”¨HTTPSä¼ è¾“ä¿æŠ¤SessionID  
â€¢ å®šæœŸé‡æ–°ç”ŸæˆSessionID
â€¢ è®¾ç½®åˆç†çš„Sessionè¶…æ—¶æ—¶é—´

æ€§èƒ½ä¼˜åŒ–åŸåˆ™ï¼š
â€¢ é¿å…åœ¨Sessionä¸­å­˜å‚¨å¤§å¯¹è±¡
â€¢ åŠæ—¶æ¸…ç†æ— ç”¨çš„Sessionæ•°æ®
â€¢ ä½¿ç”¨Sessionå¤åˆ¶æ—¶è€ƒè™‘ç½‘ç»œå¼€é”€
â€¢ åˆç†è®¾è®¡Sessionå­˜å‚¨ç»“æ„
```

**ğŸ”¹ åˆ†å¸ƒå¼ç¯å¢ƒé€‰å‹æŒ‡å¯¼**
```
å°è§„æ¨¡åº”ç”¨ï¼ˆ1-3å°æœåŠ¡å™¨ï¼‰ï¼š
â†’ Sessionç²˜æ» + æ•°æ®åº“å¤‡ä»½

ä¸­ç­‰è§„æ¨¡åº”ç”¨ï¼ˆ3-10å°æœåŠ¡å™¨ï¼‰ï¼š
â†’ Sessionå¤åˆ¶ æˆ– Rediså…±äº«å­˜å‚¨

å¤§è§„æ¨¡åº”ç”¨ï¼ˆ10+å°æœåŠ¡å™¨ï¼‰ï¼š
â†’ Redisé›†ç¾¤ + åˆ†ç‰‡å­˜å‚¨
â†’ è€ƒè™‘ä½¿ç”¨JWTæ— çŠ¶æ€Token
```

### 8.3 å®é™…åº”ç”¨åœºæ™¯


- **ğŸ›’ ç”µå•†ç½‘ç«™**ï¼šè´­ç‰©è½¦ç®¡ç†ã€ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è®¢å•è·Ÿè¸ª
- **ğŸ“š åœ¨çº¿æ•™è‚²**ï¼šå­¦ä¹ è¿›åº¦è·Ÿè¸ªã€è¯¾ç¨‹æƒé™æ§åˆ¶
- **ğŸ¦ é‡‘èç³»ç»Ÿ**ï¼šç”¨æˆ·è®¤è¯ã€äº¤æ˜“çŠ¶æ€ç®¡ç†ã€é£æ§æ£€æŸ¥
- **ğŸ“± ç¤¾äº¤åº”ç”¨**ï¼šç”¨æˆ·çŠ¶æ€ã€æ¶ˆæ¯æ¨é€ã€å¥½å‹å…³ç³»
- **ğŸ® åœ¨çº¿æ¸¸æˆ**ï¼šç©å®¶çŠ¶æ€ã€æ¸¸æˆè¿›åº¦ã€é“å…·ç®¡ç†

### 8.4 å­¦ä¹ è¦ç‚¹å›é¡¾


**ğŸ’¡ ç†è§£è¦ç‚¹ï¼š**
- ä¼šè¯ç®¡ç†æ˜¯Webå¼€å‘çš„åŸºç¡€ï¼Œå¿…é¡»æ·±å…¥æŒæ¡
- Sessionå’ŒCookieå„æœ‰ä¼˜åŠ¿ï¼Œè¦æ ¹æ®åœºæ™¯é€‰æ‹©ä½¿ç”¨  
- å®‰å…¨æ€§æ˜¯ä¼šè¯ç®¡ç†çš„é‡ä¸­ä¹‹é‡ï¼Œä¸èƒ½å¿½è§†
- åˆ†å¸ƒå¼ç¯å¢ƒä¸‹è¦è€ƒè™‘æ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½å¹³è¡¡

**ğŸ› ï¸ å®è·µå»ºè®®ï¼š**
- åŠ¨æ‰‹å®ç°å®Œæ•´çš„ç™»å½•ã€è´­ç‰©è½¦åŠŸèƒ½
- æµ‹è¯•ä¸åŒä¼šè¯ç®¡ç†æ–¹æ¡ˆçš„æ€§èƒ½å·®å¼‚
- å­¦ä¹ ä½¿ç”¨Redisç­‰ç¼“å­˜æŠ€æœ¯
- å…³æ³¨Webå®‰å…¨ç›¸å…³çŸ¥è¯†

**æ ¸å¿ƒè®°å¿†**ï¼š
- ä¼šè¯ç®¡ç†è®©Webåº”ç”¨"è®°ä½"ç”¨æˆ·
- SessionæœåŠ¡å™¨å­˜ï¼ŒCookieå®¢æˆ·ç«¯å­˜
- å®‰å…¨ç¬¬ä¸€ï¼Œæ€§èƒ½ç¬¬äºŒï¼ŒåŠŸèƒ½ç¬¬ä¸‰
- åˆ†å¸ƒå¼ç¯å¢ƒéœ€è¦Sessionå…±äº«æœºåˆ¶