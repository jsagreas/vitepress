---
title: 1ã€HttpSessionä¼šè¯æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯ä¼šè¯ç®¡ç†](#1-ä»€ä¹ˆæ˜¯ä¼šè¯ç®¡ç†)
2. [HttpSessionå·¥ä½œåŸç†](#2-HttpSessionå·¥ä½œåŸç†)
3. [Sessionåˆ›å»ºä¸è·å–](#3-Sessionåˆ›å»ºä¸è·å–)
4. [SessionIDç”Ÿæˆä¸ä¼ é€’æœºåˆ¶](#4-SessionIDç”Ÿæˆä¸ä¼ é€’æœºåˆ¶)
5. [ä¼šè¯è¶…æ—¶ä¸é”€æ¯æœºåˆ¶](#5-ä¼šè¯è¶…æ—¶ä¸é”€æ¯æœºåˆ¶)
6. [Sessionå®é™…åº”ç”¨åœºæ™¯](#6-Sessionå®é™…åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ä»€ä¹ˆæ˜¯ä¼šè¯ç®¡ç†


### 1.1 ä¼šè¯çš„æ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä¼šè¯ï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹ä½ å»é“¶è¡ŒåŠäº‹çš„è¿‡ç¨‹ï¼š
```
ç°å®ç”Ÿæ´»ä¸­çš„"ä¼šè¯"ï¼š
ä½ èµ°è¿›é“¶è¡Œ â†’ å–å·æ’é˜Ÿ â†’ åŠç†ä¸šåŠ¡ â†’ ç¦»å¼€é“¶è¡Œ

æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œé“¶è¡Œå·¥ä½œäººå‘˜çŸ¥é“ä½ æ˜¯è°ï¼Œ
è®°ä½ä½ è¦åŠä»€ä¹ˆäº‹ï¼Œè¿™å°±æ˜¯ä¸€æ¬¡"ä¼šè¯"
```

åœ¨Webä¸–ç•Œé‡Œï¼Œ**ä¼šè¯ï¼ˆSessionï¼‰**å°±æ˜¯ï¼š
- **ç”¨æˆ·ä»æ‰“å¼€æµè§ˆå™¨è®¿é—®ç½‘ç«™ï¼Œåˆ°å…³é—­æµè§ˆå™¨çš„æ•´ä¸ªè¿‡ç¨‹**
- **æœåŠ¡å™¨èƒ½å¤Ÿè¯†åˆ«å’Œè·Ÿè¸ªç”¨æˆ·çš„ä¸€ç³»åˆ—è¯·æ±‚**
- **å°±åƒæœåŠ¡å‘˜è®¤è¯†ä½ ï¼Œè®°ä½ä½ ç‚¹äº†ä»€ä¹ˆèœä¸€æ ·**

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯ç®¡ç†ï¼Ÿ


**ğŸ¤” HTTPåè®®çš„"å¥å¿˜ç—‡"**

HTTPåè®®æœ‰ä¸ªç‰¹ç‚¹å«åš**æ— çŠ¶æ€**ï¼š
```
HTTPçš„æ— çŠ¶æ€ç‰¹æ€§ï¼š
ç”¨æˆ·ç¬¬1æ¬¡è¯·æ±‚ â†’ æœåŠ¡å™¨å“åº” â†’ è¿æ¥æ–­å¼€
ç”¨æˆ·ç¬¬2æ¬¡è¯·æ±‚ â†’ æœåŠ¡å™¨ä¸è®°å¾—ä½ æ˜¯è° â†’ é‡æ–°å¤„ç†
```

è¿™å°±åƒæ¯æ¬¡å»é¤å…ï¼ŒæœåŠ¡å‘˜éƒ½ä¸è®°å¾—ä½ ï¼Œæ¯æ¬¡éƒ½è¦é‡æ–°ä»‹ç»è‡ªå·±ä¸€æ ·ï¼

**ğŸ’¡ ä¼šè¯ç®¡ç†è§£å†³çš„é—®é¢˜**
- **ç”¨æˆ·èº«ä»½è¯†åˆ«**ï¼šçŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·åœ¨è®¿é—®
- **çŠ¶æ€ä¿æŒ**ï¼šè®°ä½ç”¨æˆ·çš„æ“ä½œçŠ¶æ€
- **æ•°æ®å…±äº«**ï¼šåœ¨å¤šä¸ªé¡µé¢é—´å…±äº«ç”¨æˆ·æ•°æ®

### 1.3 ä¼šè¯ç®¡ç†çš„ç°å®æ„ä¹‰


**æ—¥å¸¸åº”ç”¨åœºæ™¯ï¼š**
```
ğŸ›’ è´­ç‰©ç½‘ç«™ï¼š
   - ç™»å½•åè®°ä½ä½ æ˜¯è°
   - è´­ç‰©è½¦å•†å“åœ¨ä¸åŒé¡µé¢éƒ½èƒ½çœ‹åˆ°
   - ä¸ç”¨æ¯ä¸ªé¡µé¢éƒ½é‡æ–°ç™»å½•

ğŸ“š åœ¨çº¿å­¦ä¹ ï¼š
   - è®°ä½å­¦ä¹ è¿›åº¦
   - ä¿å­˜åšé¢˜è®°å½•
   - è·¨é¡µé¢ä¿æŒç™»å½•çŠ¶æ€

ğŸ¦ ç½‘ä¸Šé“¶è¡Œï¼š
   - å®‰å…¨ç™»å½•éªŒè¯
   - æ“ä½œè¿‡ç¨‹ä¸­ä¿æŒèº«ä»½ç¡®è®¤
   - è¶…æ—¶è‡ªåŠ¨é€€å‡ºä¿æŠ¤èµ„é‡‘å®‰å…¨
```

---

## 2. âš™ï¸ HttpSessionå·¥ä½œåŸç†


### 2.1 Sessionå·¥ä½œæœºåˆ¶å›¾è§£


```
Sessionå·¥ä½œåŸç†ç¤ºæ„å›¾ï¼š

æµè§ˆå™¨ç«¯                     æœåŠ¡å™¨ç«¯
    |                           |
    |-- ç¬¬1æ¬¡è¯·æ±‚ ------------->|
    |   (æ²¡æœ‰JSESSIONID)        |
    |                           |-- åˆ›å»ºæ–°Sessionå¯¹è±¡
    |                           |   SessionID: ABC123
    |<-- å“åº” + Set-Cookie ------|
    |   JSESSIONID=ABC123       |
    |                           |
    |-- ç¬¬2æ¬¡è¯·æ±‚ ------------->|
    |   Cookie: JSESSIONID=ABC123|-- æ ¹æ®IDæ‰¾åˆ°Session
    |                           |   å–å‡ºç”¨æˆ·æ•°æ®
    |<-- å“åº” ------------------|
    |   (å¸¦æœ‰ç”¨æˆ·ä¸ªæ€§åŒ–å†…å®¹)      |
```

### 2.2 Sessionä¸Cookieçš„å…³ç³»


**ğŸ”— å®ƒä»¬æ˜¯å¦‚ä½•é…åˆå·¥ä½œçš„ï¼Ÿ**

```
ç®€å•ç†è§£ï¼š
Cookie â†’ å°±åƒä½ çš„"ä¼šå‘˜å¡å·"
Session â†’ å°±åƒé“¶è¡Œçš„"è´¦æˆ·ä¿¡æ¯"

ä¼šå‘˜å¡å·(JSESSIONID) â†’ å­˜åœ¨ä½ çš„é’±åŒ…é‡Œ(æµè§ˆå™¨)
è´¦æˆ·ä¿¡æ¯(Sessionæ•°æ®) â†’ å­˜åœ¨é“¶è¡Œé‡‘åº“é‡Œ(æœåŠ¡å™¨å†…å­˜)

æ¯æ¬¡å»é“¶è¡Œï¼Œä½ æ‹¿å‡ºä¼šå‘˜å¡ï¼Œ
é“¶è¡Œæ ¹æ®å¡å·æ‰¾åˆ°ä½ çš„è´¦æˆ·ä¿¡æ¯
```

**æ ¸å¿ƒé…åˆæµç¨‹ï¼š**
1. **ç”¨æˆ·é¦–æ¬¡è®¿é—®**ï¼šæœåŠ¡å™¨åˆ›å»ºSessionï¼Œç”Ÿæˆå”¯ä¸€ID
2. **IDä¼ é€’ç»™æµè§ˆå™¨**ï¼šé€šè¿‡CookieæŠŠSessionIDå‘é€ç»™æµè§ˆå™¨
3. **æµè§ˆå™¨å­˜å‚¨ID**ï¼šæµè§ˆå™¨æŠŠJSESSIONIDä¿å­˜èµ·æ¥
4. **åç»­è¯·æ±‚æºå¸¦ID**ï¼šæ¯æ¬¡è¯·æ±‚éƒ½è‡ªåŠ¨å¸¦ä¸Šè¿™ä¸ªID
5. **æœåŠ¡å™¨è¯†åˆ«ç”¨æˆ·**ï¼šæ ¹æ®IDæ‰¾åˆ°å¯¹åº”çš„Sessionæ•°æ®

### 2.3 Sessionæ•°æ®å­˜å‚¨ä½ç½®


**ğŸª Sessionæ•°æ®åœ¨å“ªé‡Œï¼Ÿ**

```
Sessionæ•°æ®å­˜å‚¨ç¤ºæ„ï¼š

æœåŠ¡å™¨å†…å­˜ä¸­çš„Sessionå­˜å‚¨åŒºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SessionID: ABC123              â”‚
â”‚  â”œâ”€ username: "å¼ ä¸‰"            â”‚
â”‚  â”œâ”€ loginTime: 2025-01-23 10:00â”‚
â”‚  â””â”€ shoppingCart: [å•†å“1,å•†å“2]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SessionID: DEF456              â”‚
â”‚  â”œâ”€ username: "æå››"            â”‚
â”‚  â”œâ”€ loginTime: 2025-01-23 10:05â”‚
â”‚  â””â”€ userRole: "ç®¡ç†å‘˜"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡è¦ç†è§£ï¼š**
- **Sessionæ•°æ®åœ¨æœåŠ¡å™¨ç«¯**ï¼šå®‰å…¨ï¼Œç”¨æˆ·æ— æ³•ç›´æ¥ä¿®æ”¹
- **SessionIDåœ¨å®¢æˆ·ç«¯**ï¼šåªæ˜¯ä¸€ä¸ªç¼–å·ï¼Œä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
- **å†…å­˜å­˜å‚¨**ï¼šè®¿é—®é€Ÿåº¦å¿«ï¼Œä½†æœåŠ¡å™¨é‡å¯ä¼šä¸¢å¤±

---

## 3. ğŸ”§ Sessionåˆ›å»ºä¸è·å–


### 3.1 Sessionçš„åˆ›å»ºæ—¶æœº


**ğŸ• Sessionä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿ**

Sessionä¸æ˜¯ç”¨æˆ·ä¸€è®¿é—®å°±åˆ›å»ºçš„ï¼Œè€Œæ˜¯**æŒ‰éœ€åˆ›å»º**ï¼š

```java
// 1. è·å–Sessionï¼ˆå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
HttpSession session = request.getSession();

// 2. è·å–Sessionï¼ˆå¦‚æœä¸å­˜åœ¨è¿”å›nullï¼Œä¸åˆ›å»ºï¼‰
HttpSession session = request.getSession(false);
```

**åˆ›å»ºæ—¶æœºè¯¦è§£ï¼š**
```
ç”¨æˆ·è®¿é—®æµç¨‹ï¼š
è®¿é—®ç½‘ç«™é¦–é¡µ â†’ ä¸ä¼šåˆ›å»ºSessionï¼ˆåªæ˜¯æµè§ˆï¼‰
ç‚¹å‡»"ç™»å½•"æŒ‰é’® â†’ è°ƒç”¨getSession()æ–¹æ³• â†’ åˆ›å»ºSession
æˆ–è€…
æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ â†’ éœ€è¦è®°ä½è´­ç‰©è½¦ â†’ åˆ›å»ºSession
```

### 3.2 Sessionåˆ›å»ºä»£ç ç¤ºä¾‹


```java
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws ServletException, IOException {
        
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        
        // éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        if ("admin".equals(username) && "123456".equals(password)) {
            
            // è·å–æˆ–åˆ›å»ºSession
            HttpSession session = request.getSession();
            
            // åœ¨Sessionä¸­å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
            session.setAttribute("username", username);
            session.setAttribute("loginTime", new Date());
            session.setAttribute("isLoggedIn", true);
            
            response.getWriter().write("ç™»å½•æˆåŠŸï¼");
        } else {
            response.getWriter().write("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼");
        }
    }
}
```

### 3.3 Sessionè·å–ä¸ä½¿ç”¨


```java
@WebServlet("/profile")
public class ProfileServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        // è·å–ç°æœ‰Sessionï¼ˆä¸åˆ›å»ºæ–°çš„ï¼‰
        HttpSession session = request.getSession(false);
        
        if (session != null && session.getAttribute("isLoggedIn") != null) {
            // ç”¨æˆ·å·²ç™»å½•ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯
            String username = (String) session.getAttribute("username");
            Date loginTime = (Date) session.getAttribute("loginTime");
            
            response.getWriter().write("æ¬¢è¿ " + username + "ï¼ç™»å½•æ—¶é—´ï¼š" + loginTime);
        } else {
            // ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
            response.sendRedirect("login.html");
        }
    }
}
```

**å…³é”®ç†è§£ï¼š**
- `getSession()`ï¼šæ²¡æœ‰Sessionå°±åˆ›å»ºä¸€ä¸ª
- `getSession(false)`ï¼šæ²¡æœ‰Sessionå°±è¿”å›nullï¼Œä¸åˆ›å»º
- Sessionåƒä¸€ä¸ªMapï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®

---

## 4. ğŸ”‘ SessionIDç”Ÿæˆä¸ä¼ é€’æœºåˆ¶


### 4.1 JSESSIONIDçš„ç”Ÿæˆè§„åˆ™


**ğŸ² SessionIDæ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ**

```
JSESSIONIDç”Ÿæˆæœºåˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éšæœºç®—æ³• + æ—¶é—´æˆ³ + æœåŠ¡å™¨ä¿¡æ¯   â”‚
â”‚              â†“                  â”‚
â”‚  ç”Ÿæˆå”¯ä¸€çš„32ä½å­—ç¬¦ä¸²            â”‚
â”‚  ä¾‹å¦‚ï¼šA1B2C3D4E5F6...          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
âœ… å”¯ä¸€æ€§ï¼šå‡ ä¹ä¸å¯èƒ½é‡å¤
âœ… éšæœºæ€§ï¼šæ— æ³•è¢«çŒœæµ‹
âœ… å®‰å…¨æ€§ï¼šä¸åŒ…å«ç”¨æˆ·ä¿¡æ¯
```

**SessionIDç¤ºä¾‹ï¼š**
```
å…¸å‹çš„JSESSIONIDæ ¼å¼ï¼š
JSESSIONID=8F4E8B2A4C6D8E0F2G4H6I8J0K2L4M6N

è¯´æ˜ï¼š
- é•¿åº¦é€šå¸¸32ä½
- åŒ…å«æ•°å­—å’Œå­—æ¯
- æ¯ä¸ªç”¨æˆ·éƒ½ä¸ç›¸åŒ
- æœåŠ¡å™¨é‡å¯åä¼šé‡æ–°ç”Ÿæˆ
```

### 4.2 JSESSIONIDä¼ é€’æ–¹å¼


**ğŸ“® SessionIDæ€ä¹ˆåœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨é—´ä¼ é€’ï¼Ÿ**

| ä¼ é€’æ–¹å¼ | è¯´æ˜ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---------|------|------|------|
| **Cookieæ–¹å¼** | è‡ªåŠ¨åœ¨HTTPå¤´ä¸­ä¼ é€’ | è‡ªåŠ¨åŒ–ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ | ç”¨æˆ·å¯èƒ½ç¦ç”¨Cookie |
| **URLé‡å†™** | åœ¨URLåé¢æ‹¼æ¥å‚æ•° | ä¸ä¾èµ–Cookie | URLå˜é•¿ï¼Œç”¨æˆ·ä½“éªŒå·® |
| **è¡¨å•éšè—å­—æ®µ** | åœ¨è¡¨å•ä¸­æ·»åŠ éšè—input | å…¼å®¹æ€§å¥½ | åªé€‚ç”¨äºè¡¨å•æäº¤ |

### 4.3 Cookieæ–¹å¼ä¼ é€’æµç¨‹


```
Cookieä¼ é€’SessionIDæµç¨‹ï¼š

ç¬¬1æ¬¡è¯·æ±‚ï¼ˆæ²¡æœ‰Cookieï¼‰ï¼š
æµè§ˆå™¨ â†’ GET /login.html â†’ æœåŠ¡å™¨
       â† å“åº” + Set-Cookie: JSESSIONID=ABC123 â†

ç¬¬2æ¬¡è¯·æ±‚ï¼ˆè‡ªåŠ¨æºå¸¦Cookieï¼‰ï¼š
æµè§ˆå™¨ â†’ POST /login + Cookie: JSESSIONID=ABC123 â†’ æœåŠ¡å™¨
       â† å“åº”å†…å®¹ â†

åç»­æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨æºå¸¦è¿™ä¸ªCookieï¼
```

### 4.4 URLé‡å†™æ–¹å¼ç¤ºä¾‹


```java
// å½“ç”¨æˆ·ç¦ç”¨Cookieæ—¶ï¼Œä½¿ç”¨URLé‡å†™
public class SessionUrlRewriteServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        HttpSession session = request.getSession();
        session.setAttribute("user", "å¼ ä¸‰");
        
        // URLé‡å†™ï¼Œç¡®ä¿SessionIDèƒ½å¤Ÿä¼ é€’
        String loginUrl = response.encodeURL("login.html");
        String profileUrl = response.encodeURL("profile.html");
        
        response.setContentType("text/html;charset=UTF-8");
        response.getWriter().write(
            "<a href='" + loginUrl + "'>ç™»å½•é¡µé¢</a><br>" +
            "<a href='" + profileUrl + "'>ä¸ªäººä¸­å¿ƒ</a>"
        );
    }
}
```

**URLé‡å†™æ•ˆæœï¼š**
```
åŸå§‹URLï¼šhttp://localhost:8080/profile.html
é‡å†™åï¼šhttp://localhost:8080/profile.html;jsessionid=ABC123

å…³é”®ç‚¹ï¼š
- åœ¨URLåé¢ç”¨åˆ†å·åˆ†éš”
- jsessionidå‚æ•°åŒ…å«SessionID
- æ‰€æœ‰é“¾æ¥éƒ½éœ€è¦é‡å†™æ‰èƒ½ä¿æŒSession
```

---

## 5. â° ä¼šè¯è¶…æ—¶ä¸é”€æ¯æœºåˆ¶


### 5.1 ä¼šè¯è¶…æ—¶è®¾ç½®


**ğŸ•’ ä¸ºä»€ä¹ˆè¦è®¾ç½®è¶…æ—¶ï¼Ÿ**

æƒ³è±¡ç½‘ä¸Šé“¶è¡Œçš„ä½¿ç”¨åœºæ™¯ï¼š
```
ç”¨æˆ·åœºæ™¯ï¼š
ç™»å½•ç½‘ä¸Šé“¶è¡Œ â†’ æŸ¥çœ‹ä½™é¢ â†’ ä¸´æ—¶ç¦»å¼€ç”µè„‘ â†’ é•¿æ—¶é—´æœªæ“ä½œ

å®‰å…¨é£é™©ï¼š
å¦‚æœSessionæ°¸ä¸è¿‡æœŸ â†’ åˆ«äººç”¨ä½ çš„ç”µè„‘ â†’ å¯èƒ½ç›—ç”¨è´¦æˆ·

è§£å†³æ–¹æ¡ˆï¼š
è®¾ç½®è¶…æ—¶æ—¶é—´ â†’ 30åˆ†é’Ÿæ— æ“ä½œ â†’ è‡ªåŠ¨é€€å‡ºç™»å½•
```

### 5.2 è¶…æ—¶æ—¶é—´é…ç½®æ–¹å¼


**æ–¹å¼ä¸€ï¼šå…¨å±€é…ç½®ï¼ˆweb.xmlï¼‰**
```xml
<web-app>
    <!-- è®¾ç½®å…¨å±€Sessionè¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰ -->
    <session-config>
        <session-timeout>30</session-timeout>
    </session-config>
</web-app>
```

**æ–¹å¼äºŒï¼šä»£ç è®¾ç½®**
```java
// ä¸ºç‰¹å®šSessionè®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
HttpSession session = request.getSession();
session.setMaxInactiveInterval(1800); // 30åˆ†é’Ÿ = 30*60ç§’
```

**æ–¹å¼ä¸‰ï¼šæœåŠ¡å™¨é»˜è®¤é…ç½®**
```
ä¸åŒæœåŠ¡å™¨çš„é»˜è®¤è¶…æ—¶æ—¶é—´ï¼š
Tomcat: 30åˆ†é’Ÿ
Jetty: 30åˆ†é’Ÿ
WebLogic: 3600ç§’ï¼ˆ60åˆ†é’Ÿï¼‰

æ³¨æ„ï¼šå¦‚æœä¸è®¾ç½®ï¼Œä½¿ç”¨æœåŠ¡å™¨é»˜è®¤å€¼
```

### 5.3 ä¼šè¯é”€æ¯çš„å‡ ç§æƒ…å†µ


**ğŸ—‘ï¸ Sessionä»€ä¹ˆæ—¶å€™ä¼šè¢«é”€æ¯ï¼Ÿ**

```java
// 1. è¶…æ—¶è‡ªåŠ¨é”€æ¯
// ç”¨æˆ·30åˆ†é’Ÿæ— ä»»ä½•æ“ä½œï¼ŒSessionè‡ªåŠ¨å¤±æ•ˆ

// 2. ä¸»åŠ¨é”€æ¯Session
HttpSession session = request.getSession(false);
if (session != null) {
    session.invalidate(); // ç«‹å³é”€æ¯Session
}

// 3. æœåŠ¡å™¨å…³é—­
// æœåŠ¡å™¨é‡å¯æ—¶ï¼Œæ‰€æœ‰Sessionéƒ½ä¼šä¸¢å¤±

// 4. æµè§ˆå™¨å…³é—­
// æµè§ˆå™¨å…³é—­æ—¶ï¼ŒCookieæ¶ˆå¤±ï¼ŒSessionå˜å¾—æ— æ³•è®¿é—®
// æ³¨æ„ï¼šSessionå¯¹è±¡è¿˜åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ï¼Œç­‰å¾…è¶…æ—¶æ¸…ç†
```

### 5.4 é€€å‡ºç™»å½•å®ç°


```java
@WebServlet("/logout")
public class LogoutServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        // è·å–å½“å‰Session
        HttpSession session = request.getSession(false);
        
        if (session != null) {
            // å¯ä»¥å…ˆä¿å­˜ä¸€äº›é€€å‡ºæ—¥å¿—
            String username = (String) session.getAttribute("username");
            System.out.println("ç”¨æˆ· " + username + " é€€å‡ºç™»å½•");
            
            // é”€æ¯Session
            session.invalidate();
        }
        
        // è·³è½¬åˆ°ç™»å½•é¡µé¢
        response.sendRedirect("login.html");
    }
}
```

**é”€æ¯æ•ˆæœï¼š**
```
Sessioné”€æ¯åçš„å˜åŒ–ï¼š
âœ… æœåŠ¡å™¨å†…å­˜ä¸­çš„Sessionå¯¹è±¡è¢«åˆ é™¤
âœ… å­˜å‚¨åœ¨Sessionä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æ¶ˆå¤±
âœ… æµè§ˆå™¨çš„JSESSIONID Cookieä»ç„¶å­˜åœ¨
âœ… ä½†ç”¨è¿™ä¸ªIDå†ä¹Ÿæ‰¾ä¸åˆ°å¯¹åº”çš„Sessionäº†
```

---

## 6. ğŸ¯ Sessionå®é™…åº”ç”¨åœºæ™¯


### 6.1 ç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†


**ğŸ“± ç™»å½•ç³»ç»Ÿçš„å®Œæ•´å®ç°**

```java
// ç™»å½•éªŒè¯
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws ServletException, IOException {
        
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        
        // éªŒè¯ç”¨æˆ·ï¼ˆå®é™…é¡¹ç›®ä¸­ä¼šæŸ¥è¯¢æ•°æ®åº“ï¼‰
        if (validateUser(username, password)) {
            HttpSession session = request.getSession();
            
            // å­˜å‚¨ç™»å½•ä¿¡æ¯
            session.setAttribute("username", username);
            session.setAttribute("loginTime", new Date());
            session.setAttribute("isAdmin", isAdminUser(username));
            
            response.sendRedirect("welcome.jsp");
        } else {
            request.setAttribute("errorMsg", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            request.getRequestDispatcher("login.jsp").forward(request, response);
        }
    }
}

// ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨
@WebFilter("/*")
public class LoginCheckFilter implements Filter {
    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) 
            throws IOException, ServletException {
        
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) resp;
        
        String uri = request.getRequestURI();
        
        // ä¸éœ€è¦ç™»å½•çš„é¡µé¢
        if (uri.endsWith("login.jsp") || uri.endsWith("login")) {
            chain.doFilter(request, response);
            return;
        }
        
        // æ£€æŸ¥æ˜¯å¦ç™»å½•
        HttpSession session = request.getSession(false);
        if (session == null || session.getAttribute("username") == null) {
            response.sendRedirect("login.jsp");
            return;
        }
        
        chain.doFilter(request, response);
    }
}
```

### 6.2 è´­ç‰©è½¦åŠŸèƒ½å®ç°


**ğŸ›’ è´­ç‰©è½¦çš„Sessionå­˜å‚¨**

```java
@WebServlet("/addToCart")
public class AddToCartServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws ServletException, IOException {
        
        String productId = request.getParameter("productId");
        String productName = request.getParameter("productName");
        int quantity = Integer.parseInt(request.getParameter("quantity"));
        
        HttpSession session = request.getSession();
        
        // ä»Sessionä¸­è·å–è´­ç‰©è½¦
        Map<String, CartItem> cart = (Map<String, CartItem>) session.getAttribute("cart");
        
        // å¦‚æœè´­ç‰©è½¦ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„
        if (cart == null) {
            cart = new HashMap<>();
            session.setAttribute("cart", cart);
        }
        
        // æ·»åŠ æˆ–æ›´æ–°å•†å“
        if (cart.containsKey(productId)) {
            CartItem item = cart.get(productId);
            item.setQuantity(item.getQuantity() + quantity);
        } else {
            CartItem item = new CartItem(productId, productName, quantity);
            cart.put(productId, item);
        }
        
        response.getWriter().write("å•†å“å·²åŠ å…¥è´­ç‰©è½¦");
    }
}

// è´­ç‰©è½¦é¡¹ç›®ç±»
class CartItem {
    private String productId;
    private String productName;
    private int quantity;
    
    // æ„é€ æ–¹æ³•å’Œgetter/setterçœç•¥
}
```

### 6.3 ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ª


**ğŸ“Š è®¿é—®è®°å½•ä¸ç»Ÿè®¡**

```java
@WebServlet("/pageVisit")
public class PageVisitServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        HttpSession session = request.getSession();
        
        // è·å–è®¿é—®å†å²
        List<String> visitHistory = (List<String>) session.getAttribute("visitHistory");
        if (visitHistory == null) {
            visitHistory = new ArrayList<>();
            session.setAttribute("visitHistory", visitHistory);
        }
        
        // è®°å½•å½“å‰è®¿é—®çš„é¡µé¢
        String currentPage = request.getRequestURI();
        visitHistory.add(currentPage + " - " + new Date());
        
        // é™åˆ¶å†å²è®°å½•æ•°é‡ï¼ˆåªä¿ç•™æœ€è¿‘10æ¡ï¼‰
        if (visitHistory.size() > 10) {
            visitHistory.remove(0);
        }
        
        // ç»Ÿè®¡ä¿¡æ¯
        Integer visitCount = (Integer) session.getAttribute("visitCount");
        visitCount = (visitCount == null) ? 1 : visitCount + 1;
        session.setAttribute("visitCount", visitCount);
        
        // æ˜¾ç¤ºè®¿é—®ä¿¡æ¯
        response.setContentType("text/html;charset=UTF-8");
        response.getWriter().write(
            "<h3>æ‚¨çš„è®¿é—®ä¿¡æ¯</h3>" +
            "<p>è®¿é—®æ¬¡æ•°ï¼š" + visitCount + "</p>" +
            "<p>æœ€è¿‘è®¿é—®é¡µé¢ï¼š</p><ul>"
        );
        
        for (String visit : visitHistory) {
            response.getWriter().write("<li>" + visit + "</li>");
        }
        
        response.getWriter().write("</ul>");
    }
}
```

### 6.4 ä¸´æ—¶æ•°æ®å­˜å‚¨


**ğŸ’¾ è¡¨å•æ•°æ®æš‚å­˜**

```java
// è¡¨å•æ•°æ®ä¿å­˜åˆ°Session
@WebServlet("/saveForm")
public class SaveFormServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws ServletException, IOException {
        
        HttpSession session = request.getSession();
        
        // ä¿å­˜è¡¨å•æ•°æ®åˆ°Session
        session.setAttribute("formName", request.getParameter("name"));
        session.setAttribute("formEmail", request.getParameter("email"));
        session.setAttribute("formPhone", request.getParameter("phone"));
        session.setAttribute("formAddress", request.getParameter("address"));
        
        response.getWriter().write("è¡¨å•æ•°æ®å·²æš‚å­˜ï¼Œæ‚¨å¯ä»¥ç¨åç»§ç»­å¡«å†™");
    }
}

// æ¢å¤è¡¨å•æ•°æ®
@WebServlet("/loadForm")
public class LoadFormServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        HttpSession session = request.getSession(false);
        
        if (session != null) {
            // ä»Sessionæ¢å¤è¡¨å•æ•°æ®
            request.setAttribute("savedName", session.getAttribute("formName"));
            request.setAttribute("savedEmail", session.getAttribute("formEmail"));
            request.setAttribute("savedPhone", session.getAttribute("formPhone"));
            request.setAttribute("savedAddress", session.getAttribute("formAddress"));
        }
        
        request.getRequestDispatcher("form.jsp").forward(request, response);
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¼šè¯æœ¬è´¨ï¼šæœåŠ¡å™¨è¯†åˆ«å’Œè·Ÿè¸ªç”¨æˆ·çš„æœºåˆ¶
ğŸ”¸ å·¥ä½œåŸç†ï¼šSessionID + Cookieé…åˆå®ç°çŠ¶æ€ä¿æŒ
ğŸ”¸ åˆ›å»ºæ—¶æœºï¼šè°ƒç”¨getSession()æ–¹æ³•æ—¶æŒ‰éœ€åˆ›å»º
ğŸ”¸ æ•°æ®å­˜å‚¨ï¼šSessionæ•°æ®åœ¨æœåŠ¡å™¨å†…å­˜ï¼ŒSessionIDåœ¨å®¢æˆ·ç«¯Cookie
ğŸ”¸ è¶…æ—¶æœºåˆ¶ï¼šé˜²æ­¢èµ„æºæµªè´¹å’Œå®‰å…¨é£é™©çš„é‡è¦ä¿éšœ
ğŸ”¸ é”€æ¯æ—¶æœºï¼šè¶…æ—¶ã€ä¸»åŠ¨é”€æ¯ã€æœåŠ¡å™¨å…³é—­ã€æµè§ˆå™¨å…³é—­
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Session vs Cookieçš„åŒºåˆ«**
```
Sessionï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ï¼š
âœ… å®‰å…¨æ€§é«˜ï¼šæ•°æ®å­˜åœ¨æœåŠ¡å™¨ï¼Œç”¨æˆ·æ— æ³•ä¿®æ”¹
âœ… å­˜å‚¨å®¹é‡å¤§ï¼šç†è®ºä¸Šæ— é™åˆ¶
âŒ æœåŠ¡å™¨å‹åŠ›ï¼šå ç”¨æœåŠ¡å™¨å†…å­˜
âŒ é›†ç¾¤å¤æ‚ï¼šå¤šå°æœåŠ¡å™¨é—´SessionåŒæ­¥å›°éš¾

Cookieï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼š
âœ… æœåŠ¡å™¨å‹åŠ›å°ï¼šæ•°æ®å­˜åœ¨å®¢æˆ·ç«¯
âœ… é›†ç¾¤å‹å¥½ï¼šä¸ä¾èµ–æœåŠ¡å™¨çŠ¶æ€
âŒ å®‰å…¨æ€§ä½ï¼šç”¨æˆ·å¯ä»¥ä¿®æ”¹Cookieå†…å®¹
âŒ å­˜å‚¨é™åˆ¶ï¼šå•ä¸ªCookieæœ€å¤§4KB
```

**ğŸ”¹ Sessioné€‚ç”¨åœºæ™¯åˆ¤æ–­**
```
é€‚åˆä½¿ç”¨Sessionï¼š
âœ… ç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†
âœ… è´­ç‰©è½¦åŠŸèƒ½
âœ… å¤šæ­¥éª¤è¡¨å•æ•°æ®æš‚å­˜
âœ… ç”¨æˆ·ä¸ªæ€§åŒ–è®¾ç½®
âœ… å®‰å…¨æ€§è¦æ±‚é«˜çš„æ•°æ®

ä¸é€‚åˆä½¿ç”¨Sessionï¼š
âŒ ç®€å•çš„ç”¨æˆ·åå¥½è®¾ç½®
âŒ ä¸éœ€è¦å®‰å…¨ä¿æŠ¤çš„æ•°æ®
âŒ éœ€è¦é•¿æœŸä¿å­˜çš„æ•°æ®
âŒ é›†ç¾¤ç¯å¢ƒä¸‹çš„é«˜å¹¶å‘åº”ç”¨
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼åŸåˆ™


**ğŸ¯ Sessionä½¿ç”¨æœ€ä½³å®è·µ**
- **æŒ‰éœ€åˆ›å»º**ï¼šä¸è¦ä¸€è¿›ç½‘ç«™å°±åˆ›å»ºSession
- **åŠæ—¶æ¸…ç†**ï¼šä¸éœ€è¦æ—¶ä¸»åŠ¨è°ƒç”¨invalidate()
- **åˆç†è¶…æ—¶**ï¼šæ ¹æ®åº”ç”¨åœºæ™¯è®¾ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´
- **æ•°æ®ç²¾ç®€**ï¼šåªå­˜å‚¨å¿…è¦çš„æ•°æ®ï¼Œé¿å…å ç”¨è¿‡å¤šå†…å­˜
- **å®‰å…¨è€ƒè™‘**ï¼šæ•æ„Ÿæ•°æ®å¯ä»¥Sessionå­˜å‚¨ï¼Œä½†è¦æ³¨æ„è¶…æ—¶è®¾ç½®

**âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³**
```
é—®é¢˜1ï¼šSessionä¸¢å¤±
åŸå› ï¼šæœåŠ¡å™¨é‡å¯ã€è¶…æ—¶ã€æµè§ˆå™¨ç¦ç”¨Cookie
è§£å†³ï¼šURLé‡å†™ã€æ•°æ®åº“å­˜å‚¨Sessionã€é€‚å½“çš„è¶…æ—¶è®¾ç½®

é—®é¢˜2ï¼šSessionåœ¨é›†ç¾¤ç¯å¢ƒä¸‹ä¸åŒæ­¥
åŸå› ï¼šSessionå­˜å‚¨åœ¨å•å°æœåŠ¡å™¨å†…å­˜ä¸­
è§£å†³ï¼šSessionå¤åˆ¶ã€SessionæŒä¹…åŒ–ã€ä½¿ç”¨Redisç­‰å¤–éƒ¨å­˜å‚¨

é—®é¢˜3ï¼šå†…å­˜å ç”¨è¿‡é«˜
åŸå› ï¼šSessionæ•°æ®è¿‡å¤šã€è¶…æ—¶æ—¶é—´è¿‡é•¿
è§£å†³ï¼šå®šæœŸæ¸…ç†ã€å‡å°‘å­˜å‚¨æ•°æ®é‡ã€åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
```

### 7.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“ˆ å¾ªåºæ¸è¿›çš„æŒæ¡è¿‡ç¨‹**
1. **ç†è§£æ¦‚å¿µ**ï¼šå…ˆææ¸…æ¥šä»€ä¹ˆæ˜¯ä¼šè¯ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯ç®¡ç†
2. **æŒæ¡åŸºæœ¬API**ï¼šgetSession()ã€setAttribute()ã€getAttribute()
3. **ç†è§£å·¥ä½œåŸç†**ï¼šSessionIDç”Ÿæˆã€Cookieä¼ é€’æœºåˆ¶
4. **å®è·µåº”ç”¨**ï¼šç™»å½•ç³»ç»Ÿã€è´­ç‰©è½¦ç­‰å®é™…åŠŸèƒ½
5. **æ·±å…¥ä¼˜åŒ–**ï¼šè¶…æ—¶è®¾ç½®ã€é›†ç¾¤è§£å†³æ–¹æ¡ˆã€æ€§èƒ½ä¼˜åŒ–

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
HTTPæ— çŠ¶æ€è¦è®°ç‰¢ï¼ŒSessionä¼šè¯æ¥æ¶æ¡¥
IDç”Ÿæˆé éšæœºï¼ŒCookieä¼ é€’å¾ˆè‡ªåŠ¨
æœåŠ¡å™¨ç«¯å­˜æ•°æ®ï¼Œå®¢æˆ·ç«¯åªå­˜ç¼–å·
è¶…æ—¶é”€æ¯ä¸ºå®‰å…¨ï¼Œç™»å½•è´­ç‰©æœ€å¸¸è§
```