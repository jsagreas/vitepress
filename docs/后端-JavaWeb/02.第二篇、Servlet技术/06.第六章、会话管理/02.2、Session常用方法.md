---
title: 2ã€Sessionå¸¸ç”¨æ–¹æ³•
---
## ğŸ“š ç›®å½•

1. [Sessionå¯¹è±¡è·å–æ–¹æ³•](#1-Sessionå¯¹è±¡è·å–æ–¹æ³•)
2. [Sessionæ•°æ®æ“ä½œæ–¹æ³•](#2-Sessionæ•°æ®æ“ä½œæ–¹æ³•)  
3. [Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†](#3-Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†)
4. [SessionçŠ¶æ€æŸ¥è¯¢æ–¹æ³•](#4-SessionçŠ¶æ€æŸ¥è¯¢æ–¹æ³•)
5. [Sessioné…ç½®ä¸ä¼˜åŒ–](#5-Sessioné…ç½®ä¸ä¼˜åŒ–)
6. [å®æˆ˜åº”ç”¨åœºæ™¯](#6-å®æˆ˜åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”‘ Sessionå¯¹è±¡è·å–æ–¹æ³•


### 1.1 getSession()æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`getSession()`æ˜¯HttpServletRequestå¯¹è±¡æä¾›çš„æ–¹æ³•ï¼Œç”¨æ¥è·å–å½“å‰ç”¨æˆ·çš„ä¼šè¯å¯¹è±¡ã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
æƒ³è±¡Sessionå°±åƒæ˜¯é“¶è¡Œç»™ä½ å¼€çš„ä¸€ä¸ªè´¦æˆ·ï¼š
- ç¬¬ä¸€æ¬¡æ¥é“¶è¡ŒåŠä¸šåŠ¡ï¼Œé“¶è¡Œä¼šç»™ä½ å¼€ä¸€ä¸ªæ–°è´¦æˆ·
- ä¸‹æ¬¡å†æ¥ï¼Œé“¶è¡Œé€šè¿‡ä½ çš„èº«ä»½è¯å·æ‰¾åˆ°ä½ çš„è´¦æˆ·
- getSession()å°±æ˜¯è¿™ä¸ª"æ‰¾è´¦æˆ·"çš„è¿‡ç¨‹
```

**ğŸ“‹ æ–¹æ³•ç‰¹ç‚¹**
- **è‡ªåŠ¨åˆ›å»º**ï¼šå¦‚æœç”¨æˆ·è¿˜æ²¡æœ‰Sessionï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„
- **è¿”å›ç°æœ‰**ï¼šå¦‚æœç”¨æˆ·å·²æœ‰Sessionï¼Œç›´æ¥è¿”å›ç°æœ‰çš„
- **æ°¸è¿œä¸ä¸ºç©º**ï¼šè¿™ä¸ªæ–¹æ³•ç»å¯¹ä¸ä¼šè¿”å›null

```java
// è·å–Sessionå¯¹è±¡ï¼ˆæ¨èä½¿ç”¨ï¼‰
HttpSession session = request.getSession();

// ä½¿ç”¨Sessionå­˜å‚¨æ•°æ®
session.setAttribute("username", "å¼ ä¸‰");
```

### 1.2 getSession(false)æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬å«ä¹‰**  
`getSession(false)`æ˜¯æ›´è°¨æ…çš„è·å–æ–¹å¼ï¼Œä¸ä¼šä¸»åŠ¨åˆ›å»ºæ–°Sessionã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
ç»§ç»­ç”¨é“¶è¡Œè´¦æˆ·æ¯”å–»ï¼š
- getSession(false)å°±åƒé—®é“¶è¡Œ"è¿™ä¸ªäººæœ‰è´¦æˆ·å—ï¼Ÿ"
- æœ‰è´¦æˆ·å°±è¿”å›è´¦æˆ·ä¿¡æ¯
- æ²¡è´¦æˆ·å°±è¿”å›nullï¼Œä¸ä¼šæ–°å¼€è´¦æˆ·
- é€‚åˆç”¨æ¥æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•
```

**ğŸ“Š ä¸¤ç§æ–¹å¼å¯¹æ¯”**

| æ–¹æ³• | **æœ‰Sessionæ—¶** | **æ— Sessionæ—¶** | **é€‚ç”¨åœºæ™¯** |
|------|----------------|----------------|-------------|
| `getSession()` | `è¿”å›ç°æœ‰Session` | `åˆ›å»ºæ–°Session` | `éœ€è¦ä½¿ç”¨Sessionå­˜å‚¨æ•°æ®` |
| `getSession(false)` | `è¿”å›ç°æœ‰Session` | `è¿”å›null` | `æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€` |

**ğŸ› ï¸ å®é™…åº”ç”¨ç¤ºä¾‹**
```java
// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
HttpSession session = request.getSession(false);
if (session == null) {
    // ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
    response.sendRedirect("login.jsp");
    return;
}

// ç”¨æˆ·å·²ç™»å½•ï¼Œç»§ç»­å¤„ç†ä¸šåŠ¡
String username = (String) session.getAttribute("username");
```

---

## 2. ğŸ’¾ Sessionæ•°æ®æ“ä½œæ–¹æ³•


### 2.1 setAttribute()å­˜å‚¨æ•°æ®


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`setAttribute(String name, Object value)`ç”¨æ¥åœ¨Sessionä¸­å­˜å‚¨æ•°æ®ã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
Sessionå°±åƒä¸€ä¸ªéšèº«èƒŒåŒ…ï¼š
- setAttributeå°±æ˜¯å¾€èƒŒåŒ…é‡Œæ”¾ä¸œè¥¿
- nameæ˜¯æ ‡ç­¾ï¼ˆæ¯”å¦‚"æ°´æ¯"ã€"æ‰‹æœº"ï¼‰
- valueæ˜¯å®é™…çš„ç‰©å“
- ä¸‹æ¬¡éœ€è¦æ—¶ï¼Œé€šè¿‡æ ‡ç­¾å°±èƒ½æ‰¾åˆ°å¯¹åº”ç‰©å“
```

**ğŸ“ å­˜å‚¨è§„åˆ™**
- **é”®å€¼å¯¹å½¢å¼**ï¼šé€šè¿‡åç§°(name)å­˜å‚¨å€¼(value)
- **è¦†ç›–æœºåˆ¶**ï¼šç›¸åŒåç§°ä¼šè¦†ç›–åŸæœ‰æ•°æ®
- **å¯¹è±¡å­˜å‚¨**ï¼šå¯ä»¥å­˜å‚¨ä»»ä½•Javaå¯¹è±¡

```java
// å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®
session.setAttribute("username", "æå››");           // å­—ç¬¦ä¸²
session.setAttribute("userId", 12345);              // æ•°å­—
session.setAttribute("loginTime", new Date());      // æ—¥æœŸå¯¹è±¡
session.setAttribute("userInfo", userObject);       // è‡ªå®šä¹‰å¯¹è±¡
```

### 2.2 getAttribute()è·å–æ•°æ®


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`getAttribute(String name)`ç”¨æ¥ä»Sessionä¸­å–å‡ºä¹‹å‰å­˜å‚¨çš„æ•°æ®ã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
ç»§ç»­èƒŒåŒ…æ¯”å–»ï¼š
- getAttributeå°±æ˜¯ä»èƒŒåŒ…é‡Œå–ä¸œè¥¿
- é€šè¿‡æ ‡ç­¾åç§°æ‰¾åˆ°å¯¹åº”ç‰©å“
- å¦‚æœèƒŒåŒ…é‡Œæ²¡æœ‰è¿™ä¸ªæ ‡ç­¾çš„ç‰©å“ï¼Œè¿”å›null
```

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
- **è¿”å›Objectç±»å‹**ï¼šéœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢
- **å¯èƒ½è¿”å›null**ï¼šå¦‚æœSessionä¸­æ²¡æœ‰å¯¹åº”æ•°æ®
- **ç±»å‹è½¬æ¢é£é™©**ï¼šè½¬æ¢ç±»å‹ä¸åŒ¹é…ä¼šæŠ›å¼‚å¸¸

```java
// å®‰å…¨çš„æ•°æ®è·å–æ–¹å¼
String username = (String) session.getAttribute("username");
if (username != null) {
    System.out.println("ç”¨æˆ·åï¼š" + username);
} else {
    System.out.println("ç”¨æˆ·æœªç™»å½•");
}

// è·å–æ•°å­—ç±»å‹æ•°æ®
Integer userId = (Integer) session.getAttribute("userId");
```

### 2.3 removeAttribute()åˆ é™¤æ•°æ®


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`removeAttribute(String name)`ç”¨æ¥åˆ é™¤Sessionä¸­çš„æŒ‡å®šæ•°æ®ã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
è¿˜æ˜¯èƒŒåŒ…æ¯”å–»ï¼š
- removeAttributeå°±æ˜¯ä»èƒŒåŒ…é‡Œæ‹¿æ‰æŸä¸ªç‰©å“
- é€šè¿‡æ ‡ç­¾åç§°æ‰¾åˆ°å¹¶ç§»é™¤
- ç§»é™¤åï¼Œè¿™ä¸ªæ ‡ç­¾å¯¹åº”çš„ä½ç½®å°±ç©ºäº†
```

```java
// åˆ é™¤ç‰¹å®šæ•°æ®
session.removeAttribute("tempData");

// å¸¸è§ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·é€€å‡ºç™»å½•
session.removeAttribute("username");
session.removeAttribute("userRole");
```

---

## 3. â° Sessionç”Ÿå‘½å‘¨æœŸç®¡ç†


### 3.1 invalidate()é”€æ¯ä¼šè¯


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`invalidate()`æ–¹æ³•ç”¨æ¥ç«‹å³é”€æ¯æ•´ä¸ªSessionï¼Œé‡Šæ”¾æ‰€æœ‰ç›¸å…³èµ„æºã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
Sessionå°±åƒç§Ÿçš„æˆ¿å­ï¼š
- invalidate()å°±æ˜¯"é€€æˆ¿"
- é€€æˆ¿åï¼Œæˆ¿å­é‡Œçš„æ‰€æœ‰ä¸œè¥¿éƒ½è¢«æ¸…ç©º
- æˆ¿é—´é’¥åŒ™ä½œåºŸï¼Œæ— æ³•å†ä½¿ç”¨
- ä¸‹æ¬¡æ¥éœ€è¦é‡æ–°åŠç†å…¥ä½æ‰‹ç»­
```

**ğŸ¯ ä½¿ç”¨åœºæ™¯**
- **ç”¨æˆ·ç™»å‡º**ï¼šç”¨æˆ·ä¸»åŠ¨é€€å‡ºç³»ç»Ÿ
- **å®‰å…¨æ¸…ç†**ï¼šæ¸…é™¤æ•æ„Ÿä¿¡æ¯
- **å¼ºåˆ¶ä¸‹çº¿**ï¼šç®¡ç†å‘˜è¸¢å‡ºç”¨æˆ·

```java
// ç”¨æˆ·ç™»å‡ºå¤„ç†
@WebServlet("/logout")
public class LogoutServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        HttpSession session = request.getSession(false);
        if (session != null) {
            // é”€æ¯Session
            session.invalidate();
        }
        
        // è·³è½¬åˆ°ç™»å½•é¡µé¢
        response.sendRedirect("login.jsp");
    }
}
```

### 3.2 setMaxInactiveInterval()è®¾ç½®è¶…æ—¶


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`setMaxInactiveInterval(int interval)`è®¾ç½®Sessionçš„æœ€å¤§é—²ç½®æ—¶é—´ï¼ˆç§’ï¼‰ã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
Sessionåƒå›¾ä¹¦é¦†çš„åº§ä½é¢„çº¦ï¼š
- setMaxInactiveIntervalè®¾å®šåº§ä½ä¿ç•™æ—¶é—´
- æ¯”å¦‚è®¾ç½®1800ç§’ï¼ˆ30åˆ†é’Ÿï¼‰
- 30åˆ†é’Ÿå†…ä¸ä½¿ç”¨ï¼Œç³»ç»Ÿè‡ªåŠ¨å–æ¶ˆåº§ä½é¢„çº¦
- é˜²æ­¢èµ„æºè¢«é•¿æœŸå ç”¨
```

**ğŸ“Š è¶…æ—¶æ—¶é—´è®¾ç½®å‚è€ƒ**

| åº”ç”¨ç±»å‹ | **æ¨èè¶…æ—¶æ—¶é—´** | **åŸå› è¯´æ˜** |
|---------|----------------|-------------|
| `è´­ç‰©ç½‘ç«™` | `30-60åˆ†é’Ÿ` | `ç”¨æˆ·å¯èƒ½éœ€è¦æ—¶é—´æ¯”è¾ƒå•†å“` |
| `é“¶è¡Œç³»ç»Ÿ` | `10-15åˆ†é’Ÿ` | `å®‰å…¨æ€§è¦æ±‚é«˜ï¼Œé¿å…é£é™©` |
| `è®ºå›ç¤¾åŒº` | `2-4å°æ—¶` | `ç”¨æˆ·æµè§ˆæ—¶é—´è¾ƒé•¿` |
| `åå°ç®¡ç†` | `1-2å°æ—¶` | `ç®¡ç†å‘˜æ“ä½œç›¸å¯¹é¢‘ç¹` |

```java
// è®¾ç½®Sessionè¶…æ—¶æ—¶é—´
session.setMaxInactiveInterval(1800); // 30åˆ†é’Ÿ

// è·å–å½“å‰è¶…æ—¶è®¾ç½®
int timeout = session.getMaxInactiveInterval();
System.out.println("Sessionè¶…æ—¶æ—¶é—´ï¼š" + timeout + "ç§’");

// è®¾ç½®æ°¸ä¸è¶…æ—¶ï¼ˆä¸æ¨èï¼‰
session.setMaxInactiveInterval(-1);
```

---

## 4. ğŸ” SessionçŠ¶æ€æŸ¥è¯¢æ–¹æ³•


### 4.1 getId()è·å–ä¼šè¯ID


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`getId()`æ–¹æ³•è¿”å›Sessionçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆSession IDï¼‰ã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
Session IDå°±åƒèº«ä»½è¯å·ç ï¼š
- æ¯ä¸ªSessionéƒ½æœ‰å”¯ä¸€çš„ID
- è¿™ä¸ªIDç”¨æ¥åŒºåˆ†ä¸åŒç”¨æˆ·çš„ä¼šè¯
- æµè§ˆå™¨é€šè¿‡Cookieä¿å­˜è¿™ä¸ªID
- æœåŠ¡å™¨é€šè¿‡è¿™ä¸ªIDæ‰¾åˆ°å¯¹åº”çš„Sessionæ•°æ®
```

**ğŸ”— Session IDçš„å·¥ä½œæµç¨‹**
```
ç”¨æˆ·é¦–æ¬¡è®¿é—®ï¼š
æµè§ˆå™¨ â†’ æœåŠ¡å™¨ï¼šæ²¡æœ‰Session ID
æœåŠ¡å™¨ï¼šåˆ›å»ºæ–°Sessionï¼Œç”ŸæˆID (å¦‚: 1A2B3C4D)
æœåŠ¡å™¨ â†’ æµè§ˆå™¨ï¼šè¿”å›Cookie (JSESSIONID=1A2B3C4D)

ç”¨æˆ·å†æ¬¡è®¿é—®ï¼š
æµè§ˆå™¨ â†’ æœåŠ¡å™¨ï¼šæºå¸¦Cookie (JSESSIONID=1A2B3C4D)
æœåŠ¡å™¨ï¼šæ ¹æ®IDæ‰¾åˆ°å¯¹åº”Sessionæ•°æ®
```

```java
// è·å–Session ID
String sessionId = session.getId();
System.out.println("å½“å‰Session IDï¼š" + sessionId);

// åœ¨é¡µé¢æ˜¾ç¤ºSessionä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰
out.println("æ‚¨çš„ä¼šè¯IDï¼š" + sessionId);
```

### 4.2 isNew()åˆ¤æ–­æ–°ä¼šè¯


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`isNew()`æ–¹æ³•åˆ¤æ–­å½“å‰Sessionæ˜¯å¦æ˜¯æ–°åˆ›å»ºçš„ã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
isNew()å°±åƒé—®"è¿™æ˜¯æ–°å®¢æˆ·å—ï¼Ÿ"ï¼š
- trueï¼šè¿™æ˜¯æ–°åˆ›å»ºçš„Sessionï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®
- falseï¼šè¿™æ˜¯å·²å­˜åœ¨çš„Sessionï¼Œç”¨æˆ·ä¹‹å‰æ¥è¿‡
```

**ğŸ¯ åº”ç”¨åœºæ™¯**
- **æ¬¢è¿æç¤º**ï¼šæ–°ç”¨æˆ·æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
- **ç»Ÿè®¡åˆ†æ**ï¼šç»Ÿè®¡æ–°è®¿å®¢æ•°é‡
- **åˆå§‹åŒ–æ“ä½œ**ï¼šä¸ºæ–°ä¼šè¯è®¾ç½®é»˜è®¤æ•°æ®

```java
if (session.isNew()) {
    // æ–°ç”¨æˆ·å¤„ç†
    System.out.println("æ¬¢è¿æ–°ç”¨æˆ·ï¼");
    session.setAttribute("visitCount", 1);
} else {
    // è€ç”¨æˆ·å¤„ç†
    Integer count = (Integer) session.getAttribute("visitCount");
    session.setAttribute("visitCount", count + 1);
}
```

### 4.3 getCreationTime()è·å–åˆ›å»ºæ—¶é—´


**ğŸ”¸ åŸºæœ¬å«ä¹‰**
`getCreationTime()`è¿”å›Sessionåˆ›å»ºçš„æ—¶é—´æˆ³ã€‚

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
getCreationTime()å°±åƒæŸ¥çœ‹"å¼€æˆ·æ—¶é—´"ï¼š
- è¿”å›Sessionç¬¬ä¸€æ¬¡åˆ›å»ºçš„ç²¾ç¡®æ—¶é—´
- æ—¶é—´æ ¼å¼æ˜¯æ¯«ç§’æ•°ï¼ˆä»1970å¹´1æœˆ1æ—¥å¼€å§‹ï¼‰
- å¯ç”¨æ¥è®¡ç®—ç”¨æˆ·åœ¨çº¿æ—¶é•¿
```

```java
// è·å–Sessionåˆ›å»ºæ—¶é—´
long createTime = session.getCreationTime();
Date createDate = new Date(createTime);

// è®¡ç®—åœ¨çº¿æ—¶é•¿
long currentTime = System.currentTimeMillis();
long onlineTime = (currentTime - createTime) / 1000; // è½¬æ¢ä¸ºç§’

System.out.println("Sessionåˆ›å»ºæ—¶é—´ï¼š" + createDate);
System.out.println("åœ¨çº¿æ—¶é•¿ï¼š" + onlineTime + "ç§’");
```

---

## 5. âš™ï¸ Sessioné…ç½®ä¸ä¼˜åŒ–


### 5.1 web.xmlä¸­çš„Sessioné…ç½®


**ğŸ”¸ å…¨å±€è¶…æ—¶é…ç½®**
åœ¨web.xmlä¸­å¯ä»¥è®¾ç½®é»˜è®¤çš„Sessionè¶…æ—¶æ—¶é—´ã€‚

```xml
<!-- web.xmlä¸­é…ç½®Sessionè¶…æ—¶æ—¶é—´ -->
<web-app>
    <session-config>
        <!-- è®¾ç½®Sessionè¶…æ—¶æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ -->
        <session-timeout>30</session-timeout>
    </session-config>
</web-app>
```

**ğŸ’¡ é…ç½®è¯´æ˜**
- **å•ä½æ˜¯åˆ†é’Ÿ**ï¼šä¸æ˜¯ç§’ï¼Œæ³¨æ„åŒºåˆ«
- **å…¨å±€é»˜è®¤**ï¼šæ‰€æœ‰Sessionéƒ½ä½¿ç”¨è¿™ä¸ªè¶…æ—¶æ—¶é—´
- **å¯è¢«è¦†ç›–**ï¼šä»£ç ä¸­çš„è®¾ç½®ä¼šè¦†ç›–è¿™ä¸ªé…ç½®

### 5.2 Sessionæ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ”¸ å­˜å‚¨åŸåˆ™**
- âœ… **å­˜å‚¨å¿…è¦æ•°æ®**ï¼šåªå­˜ç”¨æˆ·IDã€ç”¨æˆ·åç­‰å…³é”®ä¿¡æ¯
- âœ… **åŠæ—¶æ¸…ç†**ï¼šä¸ç”¨çš„æ•°æ®åŠæ—¶remove
- âŒ **é¿å…å¤§å¯¹è±¡**ï¼šä¸è¦å­˜å‚¨å¤§æ–‡ä»¶ã€å¤§é‡æ•°æ®
- âŒ **é¿å…æ•°æ®åº“è¿æ¥**ï¼šä¸è¦åœ¨Sessionä¸­å­˜å‚¨è¿æ¥å¯¹è±¡

**ğŸ“Š å­˜å‚¨æ•°æ®å¤§å°å»ºè®®**

| æ•°æ®ç±»å‹ | **å»ºè®®åšæ³•** | **åŸå› ** |
|---------|-------------|---------|
| `ç”¨æˆ·åŸºæœ¬ä¿¡æ¯` | `âœ… å­˜å‚¨ç”¨æˆ·IDã€ç”¨æˆ·å` | `å¿…éœ€ä¸”æ•°æ®é‡å°` |
| `ç”¨æˆ·æƒé™` | `âœ… å­˜å‚¨è§’è‰²æ ‡è¯†` | `é¿å…é‡å¤æŸ¥è¯¢æ•°æ®åº“` |
| `è´­ç‰©è½¦` | `âœ… å­˜å‚¨å•†å“IDå’Œæ•°é‡` | `ç”¨æˆ·ä½“éªŒéœ€è¦` |
| `å¤§å‹å¯¹è±¡` | `âŒ ä¸å»ºè®®å­˜å‚¨` | `å ç”¨å†…å­˜ï¼Œå½±å“æ€§èƒ½` |
| `ä¸´æ—¶æ–‡ä»¶` | `âŒ ä¸å»ºè®®å­˜å‚¨` | `åº”è¯¥å­˜å‚¨åœ¨ç£ç›˜` |

---

## 6. ğŸ› ï¸ å®æˆ˜åº”ç”¨åœºæ™¯


### 6.1 ç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†


**ğŸ’¼ å®Œæ•´ç™»å½•æµç¨‹å®ç°**

```java
// ç™»å½•éªŒè¯Servlet
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws IOException {
        
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        
        // éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        if ("admin".equals(username) && "123456".equals(password)) {
            // ç™»å½•æˆåŠŸï¼Œåˆ›å»ºSession
            HttpSession session = request.getSession();
            session.setAttribute("username", username);
            session.setAttribute("loginTime", new Date());
            
            // è®¾ç½®Sessionè¶…æ—¶æ—¶é—´ï¼ˆ30åˆ†é’Ÿï¼‰
            session.setMaxInactiveInterval(1800);
            
            response.sendRedirect("main.jsp");
        } else {
            // ç™»å½•å¤±è´¥
            response.sendRedirect("login.jsp?error=1");
        }
    }
}
```

### 6.2 æƒé™æ£€æŸ¥è¿‡æ»¤å™¨


**ğŸ›¡ï¸ ç»Ÿä¸€æƒé™éªŒè¯**

```java
// ç™»å½•æ£€æŸ¥è¿‡æ»¤å™¨
@WebFilter("/admin/*")
public class LoginFilter implements Filter {
    public void doFilter(ServletRequest req, ServletResponse resp, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) resp;
        
        // æ£€æŸ¥Session
        HttpSession session = request.getSession(false);
        if (session == null || session.getAttribute("username") == null) {
            // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
            response.sendRedirect("/login.jsp");
            return;
        }
        
        // å·²ç™»å½•ï¼Œç»§ç»­å¤„ç†è¯·æ±‚
        chain.doFilter(request, response);
    }
}
```

### 6.3 è´­ç‰©è½¦åŠŸèƒ½å®ç°


**ğŸ›’ Sessionå­˜å‚¨è´­ç‰©è½¦æ•°æ®**

```java
// æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
@WebServlet("/addToCart")
public class AddToCartServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws IOException {
        
        String productId = request.getParameter("productId");
        int quantity = Integer.parseInt(request.getParameter("quantity"));
        
        HttpSession session = request.getSession();
        
        // è·å–è´­ç‰©è½¦ï¼ˆMapç»“æ„ï¼šå•†å“ID -> æ•°é‡ï¼‰
        Map<String, Integer> cart = 
            (Map<String, Integer>) session.getAttribute("cart");
        
        if (cart == null) {
            cart = new HashMap<>();
        }
        
        // æ·»åŠ æˆ–æ›´æ–°å•†å“æ•°é‡
        cart.put(productId, cart.getOrDefault(productId, 0) + quantity);
        session.setAttribute("cart", cart);
        
        response.getWriter().write("success");
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ–¹æ³•


```
ğŸ”¸ getSession() vs getSession(false)ï¼šä¼šè¯è·å–çš„ä¸¤ç§æ–¹å¼
ğŸ”¸ setAttribute() / getAttribute()ï¼šæ•°æ®å­˜å‚¨å’Œè·å–
ğŸ”¸ invalidate()ï¼šä¼šè¯é”€æ¯ï¼Œç”¨æˆ·ç™»å‡ºå¿…ç”¨
ğŸ”¸ setMaxInactiveInterval()ï¼šè®¾ç½®ä¼šè¯è¶…æ—¶æ—¶é—´
ğŸ”¸ getId() / isNew()ï¼šä¼šè¯çŠ¶æ€æŸ¥è¯¢
```

### 7.2 é‡è¦æ¦‚å¿µç†è§£


**ğŸ”¹ Sessionçš„æœ¬è´¨**
```
Sessionæ˜¯æœåŠ¡å™¨ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºçš„"ä¸´æ—¶å­˜å‚¨ç©ºé—´"ï¼š
- å­˜å‚¨ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ï¼ˆç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ç­‰ï¼‰
- é€šè¿‡Session IDåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´å»ºç«‹å…³è”
- æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œä¼šè‡ªåŠ¨è¿‡æœŸæˆ–è¢«æ‰‹åŠ¨é”€æ¯
```

**ğŸ”¹ Session vs Cookie**
```
Cookieï¼šå­˜åœ¨å®¢æˆ·ç«¯ï¼Œå®¹é‡å°ï¼Œå¯è®¾ç½®è¿‡æœŸæ—¶é—´
Sessionï¼šå­˜åœ¨æœåŠ¡å™¨ï¼Œå®¹é‡å¤§ï¼Œä¾èµ–Session ID

å®é™…åº”ç”¨ï¼šCookieå­˜Session IDï¼ŒSessionå­˜å…·ä½“æ•°æ®
```

### 7.3 æœ€ä½³å®è·µæ€»ç»“


**âœ… æ¨èåšæ³•**
- æ•æ„Ÿæ•°æ®ç”¨Sessionå­˜å‚¨ï¼ˆå¦‚ç”¨æˆ·æƒé™ï¼‰
- åŠæ—¶æ¸…ç†æ— ç”¨æ•°æ®ï¼ˆremoveAttributeï¼‰
- ç”¨æˆ·ç™»å‡ºæ—¶é”€æ¯Sessionï¼ˆinvalidateï¼‰
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆæ ¹æ®åº”ç”¨ç±»å‹ï¼‰

**âŒ é¿å…åšæ³•**  
- Sessionä¸­å­˜å‚¨å¤§é‡æ•°æ®
- é•¿æ—¶é—´ä¸ä½¿ç”¨ä»ä¿æŒSession
- å¿˜è®°å¤„ç†Sessionä¸ºnullçš„æƒ…å†µ
- åœ¨Sessionä¸­å­˜å‚¨æ•°æ®åº“è¿æ¥

### 7.4 å¸¸è§é—®é¢˜è§£å†³


| é—®é¢˜ | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|------|---------|-------------|
| `Sessionä¸¢å¤±` | `æµè§ˆå™¨ç¦ç”¨Cookie` | `URLé‡å†™æˆ–æç¤ºç”¨æˆ·å¯ç”¨Cookie` |
| `å†…å­˜å ç”¨è¿‡é«˜` | `Sessionæ•°æ®è¿‡å¤§` | `æ¸…ç†æ— ç”¨æ•°æ®ï¼Œä¼˜åŒ–å­˜å‚¨å†…å®¹` |
| `ç™»å½•çŠ¶æ€ä¸¢å¤±` | `Sessionè¶…æ—¶` | `é€‚å½“å»¶é•¿è¶…æ—¶æ—¶é—´æˆ–æ´»è·ƒæ£€æµ‹` |
| `å¹¶å‘é—®é¢˜` | `å¤šçº¿ç¨‹è®¿é—®Session` | `è°¨æ…å¤„ç†å…±äº«æ•°æ®ï¼Œè€ƒè™‘åŒæ­¥` |

**ğŸ’¡ å­¦ä¹ å»ºè®®**
- Sessionæ˜¯JavaWebå¼€å‘çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¿…é¡»ç†Ÿç»ƒæŒæ¡
- å¤šç»ƒä¹ ç™»å½•ã€è´­ç‰©è½¦ç­‰å®é™…åœºæ™¯
- ç†è§£Sessionçš„ç”Ÿå‘½å‘¨æœŸå’Œå†…å­˜ç®¡ç†
- æ³¨æ„å®‰å…¨æ€§ï¼ŒåŠæ—¶æ¸…ç†æ•æ„Ÿæ•°æ®

**æ ¸å¿ƒè®°å¿†**ï¼š
- Sessionåœ¨æœåŠ¡å™¨ï¼Œå­˜å‚¨ç”¨æˆ·çŠ¶æ€
- getSessionåˆ›å»ºï¼ŒgetSession(false)ä¸åˆ›å»º  
- setAttributeå­˜æ•°æ®ï¼ŒgetAttributeå–æ•°æ®
- invalidateé”€æ¯ï¼ŒsetMaxInactiveIntervalè®¾è¶…æ—¶