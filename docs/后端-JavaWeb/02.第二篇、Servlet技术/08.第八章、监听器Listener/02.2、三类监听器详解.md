---
title: 2ã€ä¸‰ç±»ç›‘å¬å™¨è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [ç›‘å¬å™¨åŸºç¡€æ¦‚å¿µ](#1-ç›‘å¬å™¨åŸºç¡€æ¦‚å¿µ)
2. [ServletContextListeneråº”ç”¨ç›‘å¬](#2-ServletContextListeneråº”ç”¨ç›‘å¬)
3. [HttpSessionListenerä¼šè¯ç›‘å¬](#3-HttpSessionListenerä¼šè¯ç›‘å¬)
4. [ServletRequestListenerè¯·æ±‚ç›‘å¬](#4-ServletRequestListenerè¯·æ±‚ç›‘å¬)
5. [ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†æœºåˆ¶](#5-ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†æœºåˆ¶)
6. [å±æ€§å˜åŒ–äº‹ä»¶å¤„ç†](#6-å±æ€§å˜åŒ–äº‹ä»¶å¤„ç†)
7. [ç›‘å¬å™¨é…ç½®æ–¹å¼é€‰æ‹©](#7-ç›‘å¬å™¨é…ç½®æ–¹å¼é€‰æ‹©)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç›‘å¬å™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç›‘å¬å™¨


**ğŸ”¸ ç”Ÿæ´»ç±»æ¯”**
ç›‘å¬å™¨å°±åƒå®¶é‡Œçš„**çƒŸé›¾æŠ¥è­¦å™¨**ï¼š
- å¹³æ—¶é™é™å¾…ç€ä¸å¹²æ‰°ä½ 
- ä¸€æ—¦å‘ç”Ÿç«ç¾ï¼ˆäº‹ä»¶ï¼‰ï¼Œç«‹å³å“é“ƒæŠ¥è­¦ï¼ˆæ‰§è¡Œå¤„ç†ï¼‰
- ä½ ä¸éœ€è¦ä¸»åŠ¨å»æ£€æŸ¥ï¼Œå®ƒä¼šè‡ªåŠ¨ç›‘æµ‹å¹¶å“åº”

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
ç›‘å¬å™¨ï¼ˆListenerï¼‰ï¼šä¸€ç§ç‰¹æ®Šçš„Javaç±»
ä½œç”¨ï¼šç›‘å¬Webåº”ç”¨ä¸­çš„å„ç§äº‹ä»¶
ç‰¹ç‚¹ï¼šäº‹ä»¶é©±åŠ¨ï¼Œè‡ªåŠ¨è§¦å‘ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨
æ—¶æœºï¼šåœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘
```

### 1.2 ç›‘å¬å™¨çš„å·¥ä½œåŸç†


**ğŸ“Š äº‹ä»¶é©±åŠ¨æœºåˆ¶**
```
ç”¨æˆ·è®¿é—®ç½‘ç«™ â†’ è§¦å‘å„ç§äº‹ä»¶ â†’ ç›‘å¬å™¨è‡ªåŠ¨å“åº” â†’ æ‰§è¡Œç›¸åº”å¤„ç†

å…·ä½“æµç¨‹ï¼š
1. ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—® â†’ åº”ç”¨å¯åŠ¨äº‹ä»¶ â†’ ServletContextListenerå“åº”
2. ç”¨æˆ·ç™»å½•æˆåŠŸ â†’ ä¼šè¯åˆ›å»ºäº‹ä»¶ â†’ HttpSessionListenerå“åº”  
3. ç”¨æˆ·è®¿é—®é¡µé¢ â†’ è¯·æ±‚åˆ›å»ºäº‹ä»¶ â†’ ServletRequestListenerå“åº”
```

**ğŸ¯ ç›‘å¬å™¨åˆ†ç±»å›¾**
```
JavaWEBç›‘å¬å™¨
â”œâ”€â”€ ServletContextListenerï¼ˆåº”ç”¨çº§ï¼‰
â”‚   â”œâ”€â”€ contextInitialized() - åº”ç”¨å¯åŠ¨æ—¶
â”‚   â””â”€â”€ contextDestroyed()   - åº”ç”¨å…³é—­æ—¶
â”œâ”€â”€ HttpSessionListenerï¼ˆä¼šè¯çº§ï¼‰
â”‚   â”œâ”€â”€ sessionCreated()  - ä¼šè¯åˆ›å»ºæ—¶
â”‚   â””â”€â”€ sessionDestroyed() - ä¼šè¯é”€æ¯æ—¶
â””â”€â”€ ServletRequestListenerï¼ˆè¯·æ±‚çº§ï¼‰
    â”œâ”€â”€ requestInitialized()  - è¯·æ±‚å¼€å§‹æ—¶
    â””â”€â”€ requestDestroyed()     - è¯·æ±‚ç»“æŸæ—¶
```

---

## 2. ğŸŒ ServletContextListeneråº”ç”¨ç›‘å¬


### 2.1 åŸºæœ¬æ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯ServletContext**
```
ServletContextï¼šæ•´ä¸ªWebåº”ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ
å¯ä»¥ç†è§£ä¸ºï¼šæ•´ä¸ªç½‘ç«™çš„"å¤§è„‘"æˆ–"ç®¡å®¶"
ä½œç”¨ï¼šå­˜å‚¨æ•´ä¸ªåº”ç”¨å…±äº«çš„æ•°æ®å’Œé…ç½®ä¿¡æ¯
ç”Ÿå‘½å‘¨æœŸï¼šåº”ç”¨å¯åŠ¨åˆ›å»ºï¼Œåº”ç”¨å…³é—­é”€æ¯
```

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
ServletContextå°±åƒ**å°åŒºçš„ç‰©ä¸šç®¡ç†å¤„**ï¼š
- æ•´ä¸ªå°åŒºï¼ˆWebåº”ç”¨ï¼‰åªæœ‰ä¸€ä¸ªç‰©ä¸šç®¡ç†å¤„
- ç‰©ä¸šå¼€åŠæ—¶ï¼Œå°åŒºå¼€å§‹æ­£å¸¸è¿è¥
- ç‰©ä¸šå…³é—­æ—¶ï¼Œå°åŒºåœæ­¢æœåŠ¡
- æ‰€æœ‰ä½æˆ·ï¼ˆç”¨æˆ·ï¼‰å…±äº«ç‰©ä¸šæä¾›çš„æœåŠ¡

### 2.2 ServletContextListenerè¯¦è§£


**ğŸ”¸ æ ¸å¿ƒæ–¹æ³•è¯´æ˜**
```java
public interface ServletContextListener {
    // åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰
    void contextInitialized(ServletContextEvent sce);
    
    // åº”ç”¨å…³é—­æ—¶è°ƒç”¨ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰  
    void contextDestroyed(ServletContextEvent sce);
}
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
- **æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–**ï¼šåº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºè¿æ¥æ± 
- **å®šæ—¶ä»»åŠ¡å¯åŠ¨**ï¼šå¯åŠ¨åå°å®šæ—¶ä»»åŠ¡
- **ç¼“å­˜æ•°æ®é¢„åŠ è½½**ï¼šæå‰åŠ è½½å¸¸ç”¨æ•°æ®åˆ°å†…å­˜
- **ç³»ç»Ÿé…ç½®è¯»å–**ï¼šè¯»å–é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–ç³»ç»Ÿå‚æ•°

### 2.3 å®æˆ˜ä»£ç ç¤ºä¾‹


```java
@WebListener
public class AppContextListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("ğŸš€ Webåº”ç”¨æ­£åœ¨å¯åŠ¨...");
        
        // è·å–ServletContextå¯¹è±¡
        ServletContext context = sce.getServletContext();
        
        // 1. åˆå§‹åŒ–åº”ç”¨çº§æ•°æ®
        context.setAttribute("onlineUsers", 0);
        context.setAttribute("appStartTime", new Date());
        
        // 2. è¯»å–é…ç½®æ–‡ä»¶
        String dbUrl = context.getInitParameter("database.url");
        System.out.println("ğŸ“Š æ•°æ®åº“é…ç½®ï¼š" + dbUrl);
        
        System.out.println("âœ… åº”ç”¨å¯åŠ¨å®Œæˆï¼");
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("ğŸ”„ Webåº”ç”¨æ­£åœ¨å…³é—­...");
        
        // æ¸…ç†èµ„æºï¼Œå…³é—­è¿æ¥ç­‰
        System.out.println("âœ… åº”ç”¨å…³é—­å®Œæˆï¼");
    }
}
```

**ğŸ“‹ æ‰§è¡Œæ—¶æœºè¯´æ˜**
```
æœåŠ¡å™¨å¯åŠ¨ â†’ éƒ¨ç½²Webåº”ç”¨ â†’ contextInitialized()æ‰§è¡Œ
æœåŠ¡å™¨å…³é—­ â†’ å¸è½½Webåº”ç”¨ â†’ contextDestroyed()æ‰§è¡Œ

æ³¨æ„ï¼šæ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…ï¼Œæ¯ä¸ªæ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼
```

---

## 3. ğŸ‘¤ HttpSessionListenerä¼šè¯ç›‘å¬


### 3.1 åŸºæœ¬æ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯HttpSession**
```
HttpSessionï¼šç”¨æˆ·ä¼šè¯ï¼Œè®°å½•ç”¨æˆ·è®¿é—®çŠ¶æ€
å¯ä»¥ç†è§£ä¸ºï¼šç”¨æˆ·çš„"æ¡£æ¡ˆè¢‹"
ä½œç”¨ï¼šå­˜å‚¨ç”¨æˆ·åœ¨è®¿é—®æœŸé—´çš„ä¸ªäººæ•°æ®
ç”Ÿå‘½å‘¨æœŸï¼šç”¨æˆ·é¦–æ¬¡è®¿é—®åˆ›å»ºï¼Œé•¿æ—¶é—´ä¸æ´»è·ƒæˆ–ä¸»åŠ¨é€€å‡ºæ—¶é”€æ¯
```

**ğŸ« ç”Ÿæ´»ç±»æ¯”**
HttpSessionå°±åƒ**ç”µå½±é™¢çš„è§‚å½±è¯**ï¼š
- ä¹°ç¥¨è¿›åœºæ—¶è·å¾—è§‚å½±è¯ï¼ˆä¼šè¯åˆ›å»ºï¼‰
- è§‚å½±æœŸé—´ç”¨è¯ä»¶æ ‡è¯†èº«ä»½ï¼ˆä¼šè¯ä½¿ç”¨ï¼‰
- ç”µå½±ç»“æŸæˆ–ä¸­é€”ç¦»åœºäº¤è¿˜è¯ä»¶ï¼ˆä¼šè¯é”€æ¯ï¼‰

### 3.2 HttpSessionListenerè¯¦è§£


**ğŸ”¸ æ ¸å¿ƒæ–¹æ³•è¯´æ˜**
```java
public interface HttpSessionListener {
    // ç”¨æˆ·ä¼šè¯åˆ›å»ºæ—¶è°ƒç”¨
    void sessionCreated(HttpSessionEvent se);
    
    // ç”¨æˆ·ä¼šè¯é”€æ¯æ—¶è°ƒç”¨
    void sessionDestroyed(HttpSessionEvent se);
}
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
- **åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡**ï¼šå®æ—¶ç»Ÿè®¡ç½‘ç«™åœ¨çº¿äººæ•°
- **ç”¨æˆ·è¡Œä¸ºè®°å½•**ï¼šè®°å½•ç”¨æˆ·ç™»å½•/é€€å‡ºæ—¥å¿—
- **èµ„æºåˆ†é…ç®¡ç†**ï¼šä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é…å¿…è¦èµ„æº
- **å®‰å…¨ç›‘æ§**ï¼šç›‘æ§å¼‚å¸¸ä¼šè¯è¡Œä¸º

### 3.3 å®æˆ˜ä»£ç ç¤ºä¾‹


```java
@WebListener
public class SessionCountListener implements HttpSessionListener {
    
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        // è·å–ServletContextå¯¹è±¡
        ServletContext context = se.getSession().getServletContext();
        
        // è·å–å½“å‰åœ¨çº¿äººæ•°
        Integer onlineUsers = (Integer) context.getAttribute("onlineUsers");
        if (onlineUsers == null) {
            onlineUsers = 0;
        }
        
        // åœ¨çº¿äººæ•°+1
        onlineUsers++;
        context.setAttribute("onlineUsers", onlineUsers);
        
        System.out.println("ğŸ‘‹ æ–°ç”¨æˆ·ä¸Šçº¿ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + onlineUsers);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        ServletContext context = se.getSession().getServletContext();
        
        // åœ¨çº¿äººæ•°-1
        Integer onlineUsers = (Integer) context.getAttribute("onlineUsers");
        if (onlineUsers != null && onlineUsers > 0) {
            onlineUsers--;
            context.setAttribute("onlineUsers", onlineUsers);
        }
        
        System.out.println("ğŸ‘‹ ç”¨æˆ·ç¦»çº¿ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + onlineUsers);
    }
}
```

**â° ä¼šè¯é”€æ¯æ—¶æœº**
```
ä¼šè¯é”€æ¯çš„å‡ ç§æƒ…å†µï¼š
1. ç”¨æˆ·é•¿æ—¶é—´ä¸æ´»è·ƒï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰
2. ç”¨æˆ·ä¸»åŠ¨é€€å‡ºï¼ˆè°ƒç”¨session.invalidate()ï¼‰
3. æœåŠ¡å™¨é‡å¯æˆ–åº”ç”¨é‡æ–°éƒ¨ç½²
4. ç¨‹åºä¸­æ‰‹åŠ¨è®¾ç½®ä¼šè¯è¿‡æœŸæ—¶é—´åˆ°è¾¾
```

---

## 4. ğŸ“¨ ServletRequestListenerè¯·æ±‚ç›‘å¬


### 4.1 åŸºæœ¬æ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯ServletRequest**
```
ServletRequestï¼šç”¨æˆ·çš„ä¸€æ¬¡è¯·æ±‚
å¯ä»¥ç†è§£ä¸ºï¼šç”¨æˆ·å‘æœåŠ¡å™¨å‘é€çš„ä¸€å°"ä¿¡ä»¶"
ä½œç”¨ï¼šåŒ…å«ç”¨æˆ·è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆå‚æ•°ã€å¤´ä¿¡æ¯ç­‰ï¼‰
ç”Ÿå‘½å‘¨æœŸï¼šè¯·æ±‚å¼€å§‹åˆ›å»ºï¼Œå“åº”ç»“æŸåé”€æ¯
```

**ğŸ“® ç”Ÿæ´»ç±»æ¯”**
ServletRequestå°±åƒ**å¿«é€’åŒ…è£¹**ï¼š
- ç”¨æˆ·ä¸‹å•æ—¶å¿«é€’äº§ç”Ÿï¼ˆè¯·æ±‚åˆ›å»ºï¼‰
- å¿«é€’è¿è¾“è¿‡ç¨‹ä¸­åŒ…å«æ‰€æœ‰ä¿¡æ¯ï¼ˆè¯·æ±‚å¤„ç†ï¼‰
- å¿«é€’é€è¾¾ç­¾æ”¶åä»»åŠ¡å®Œæˆï¼ˆè¯·æ±‚é”€æ¯ï¼‰

### 4.2 ServletRequestListenerè¯¦è§£


**ğŸ”¸ æ ¸å¿ƒæ–¹æ³•è¯´æ˜**
```java
public interface ServletRequestListener {
    // è¯·æ±‚å¼€å§‹æ—¶è°ƒç”¨
    void requestInitialized(ServletRequestEvent sre);
    
    // è¯·æ±‚ç»“æŸæ—¶è°ƒç”¨
    void requestDestroyed(ServletRequestEvent sre);
}
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
- **è¯·æ±‚æ—¥å¿—è®°å½•**ï¼šè®°å½•æ¯ä¸ªç”¨æˆ·è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯
- **æ€§èƒ½ç›‘æ§**ï¼šç»Ÿè®¡è¯·æ±‚å¤„ç†æ—¶é—´
- **è®¿é—®ç»Ÿè®¡**ï¼šç»Ÿè®¡ç½‘ç«™è®¿é—®é‡å’Œçƒ­é—¨é¡µé¢
- **å®‰å…¨è¿‡æ»¤**ï¼šæ£€æµ‹å¯ç–‘è¯·æ±‚å¹¶è®°å½•

### 4.3 å®æˆ˜ä»£ç ç¤ºä¾‹


```java
@WebListener
public class RequestLogListener implements ServletRequestListener {
    
    @Override
    public void requestInitialized(ServletRequestEvent sre) {
        HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();
        
        // è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        request.setAttribute("startTime", startTime);
        
        // è·å–è¯·æ±‚ä¿¡æ¯
        String url = request.getRequestURL().toString();
        String ip = request.getRemoteAddr();
        
        System.out.println("ğŸ“¥ è¯·æ±‚å¼€å§‹ï¼š" + ip + " è®¿é—® " + url);
    }
    
    @Override
    public void requestDestroyed(ServletRequestEvent sre) {
        HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();
        
        // è®¡ç®—è¯·æ±‚å¤„ç†æ—¶é—´
        Long startTime = (Long) request.getAttribute("startTime");
        if (startTime != null) {
            long duration = System.currentTimeMillis() - startTime;
            System.out.println("ğŸ“¤ è¯·æ±‚ç»“æŸï¼Œå¤„ç†æ—¶é—´ï¼š" + duration + "ms");
        }
    }
}
```

**ğŸ”„ è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ**
```
ç”¨æˆ·ç‚¹å‡»é“¾æ¥/æäº¤è¡¨å• â†’ requestInitialized()
â†“
Servletå¤„ç†è¯·æ±‚
â†“  
ç”Ÿæˆå“åº”è¿”å›ç»™ç”¨æˆ· â†’ requestDestroyed()

æ³¨æ„ï¼šæ¯ä¸ªç”¨æˆ·è¯·æ±‚éƒ½ä¼šè§¦å‘ä¸€æ¬¡å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼
```

---

## 5. ğŸ”„ ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†æœºåˆ¶


### 5.1 ç”Ÿå‘½å‘¨æœŸå±‚æ¬¡ç†è§£


**ğŸ¢ åŠå…¬æ¥¼ç±»æ¯”**
```
ServletContext    â†’ æ•´æ ‹åŠå…¬æ¥¼ï¼ˆåº”ç”¨çº§ï¼‰
HttpSession       â†’ æŸä¸ªå…¬å¸ç§Ÿç”¨çš„åŠå…¬å®¤ï¼ˆä¼šè¯çº§ï¼‰
ServletRequest    â†’ è®¿å®¢è¿›å‡ºåŠå…¬å®¤çš„ä¸€æ¬¡è®¿é—®ï¼ˆè¯·æ±‚çº§ï¼‰

ç”Ÿå‘½å‘¨æœŸé•¿çŸ­ï¼š
åŠå…¬æ¥¼ï¼ˆå‡ å¹´ï¼‰ > åŠå…¬å®¤ç§ŸæœŸï¼ˆå‡ ä¸ªæœˆï¼‰ > å•æ¬¡è®¿é—®ï¼ˆå‡ åˆ†é’Ÿï¼‰
```

### 5.2 äº‹ä»¶è§¦å‘é¡ºåº


**ğŸ“Š å®Œæ•´äº‹ä»¶æµç¨‹å›¾**
```
æœåŠ¡å™¨å¯åŠ¨
    â†“
[ServletContextListener.contextInitialized()] â† åº”ç”¨å¯åŠ¨
    â†“
ç”¨æˆ·é¦–æ¬¡è®¿é—®
    â†“
[HttpSessionListener.sessionCreated()] â† ä¼šè¯åˆ›å»º
    â†“
[ServletRequestListener.requestInitialized()] â† è¯·æ±‚å¼€å§‹
    â†“
Servletå¤„ç†è¯·æ±‚
    â†“
[ServletRequestListener.requestDestroyed()] â† è¯·æ±‚ç»“æŸ
    â†“
ç”¨æˆ·ç»§ç»­è®¿é—®ï¼ˆé‡å¤è¯·æ±‚ç›‘å¬è¿‡ç¨‹ï¼‰
    â†“
ç”¨æˆ·ç¦»çº¿æˆ–ä¼šè¯è¶…æ—¶
    â†“
[HttpSessionListener.sessionDestroyed()] â† ä¼šè¯é”€æ¯
    â†“
æœåŠ¡å™¨å…³é—­
    â†“
[ServletContextListener.contextDestroyed()] â† åº”ç”¨å…³é—­
```

### 5.3 ç”Ÿå‘½å‘¨æœŸç›‘å¬æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**
```
ServletContextListenerï¼š
âœ“ åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
âœ“ åŠ è½½ç³»ç»Ÿé…ç½®å‚æ•°
âœ“ å¯åŠ¨å®šæ—¶ä»»åŠ¡

HttpSessionListenerï¼š
âœ“ ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°é‡
âœ“ è®°å½•ç”¨æˆ·ç™»å½•æ—¥å¿—
âœ“ æ¸…ç†ç”¨æˆ·ç›¸å…³èµ„æº

ServletRequestListenerï¼š
âœ“ è®°å½•è®¿é—®æ—¥å¿—
âœ“ ç»Ÿè®¡è¯·æ±‚æ€§èƒ½
âœ“ å®ç°è¯·æ±‚è®¡æ•°å™¨
```

**âŒ é¿å…åšæ³•**
```
ä¸è¦åœ¨ç›‘å¬å™¨ä¸­ï¼š
Ã— æ‰§è¡Œè€—æ—¶çš„æ•°æ®åº“æ“ä½œ
Ã— è¿›è¡Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘å¤„ç†
Ã— é˜»å¡å…¶ä»–è¯·æ±‚çš„å¤„ç†
Ã— æŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸
```

---

## 6. ğŸ”§ å±æ€§å˜åŒ–äº‹ä»¶å¤„ç†


### 6.1 å±æ€§ç›‘å¬å™¨æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å±æ€§å˜åŒ–ç›‘å¬**
```
ä½œç”¨ï¼šç›‘å¬ServletContextã€HttpSessionã€ServletRequestä¸­å±æ€§çš„å˜åŒ–
äº‹ä»¶ç±»å‹ï¼š
- å±æ€§æ·»åŠ ï¼ˆattributeAddedï¼‰
- å±æ€§ä¿®æ”¹ï¼ˆattributeReplacedï¼‰  
- å±æ€§åˆ é™¤ï¼ˆattributeRemovedï¼‰
```

**ğŸ—ƒï¸ æ–‡ä»¶æŸœç±»æ¯”**
å±æ€§å˜åŒ–ç›‘å¬å°±åƒ**æ–‡ä»¶æŸœçš„ç®¡ç†å‘˜**ï¼š
- æœ‰æ–°æ–‡ä»¶æ”¾å…¥æ—¶è®°å½•ï¼ˆå±æ€§æ·»åŠ ï¼‰
- æ–‡ä»¶å†…å®¹ä¿®æ”¹æ—¶è®°å½•ï¼ˆå±æ€§æ›¿æ¢ï¼‰
- æ–‡ä»¶è¢«å–èµ°æ—¶è®°å½•ï¼ˆå±æ€§ç§»é™¤ï¼‰

### 6.2 ä¸‰ç§å±æ€§ç›‘å¬å™¨


**ğŸ“‹ å±æ€§ç›‘å¬å™¨å¯¹æ¯”è¡¨**

| ç›‘å¬å™¨ç±»å‹ | **ç›‘å¬èŒƒå›´** | **ç”Ÿå‘½å‘¨æœŸ** | **å…¸å‹ç”¨é€”** |
|-----------|-------------|--------------|-------------|
| `ServletContextAttributeListener` | `åº”ç”¨çº§å±æ€§` | `æ•´ä¸ªåº”ç”¨æœŸé—´` | `å…¨å±€é…ç½®å˜åŒ–ç›‘æ§` |
| `HttpSessionAttributeListener` | `ä¼šè¯çº§å±æ€§` | `ç”¨æˆ·ä¼šè¯æœŸé—´` | `ç”¨æˆ·çŠ¶æ€å˜åŒ–è·Ÿè¸ª` |
| `ServletRequestAttributeListener` | `è¯·æ±‚çº§å±æ€§` | `å•æ¬¡è¯·æ±‚æœŸé—´` | `è¯·æ±‚æ•°æ®å˜åŒ–è®°å½•` |

### 6.3 ä¼šè¯å±æ€§ç›‘å¬å®ä¾‹


```java
@WebListener
public class SessionAttributeListener implements HttpSessionAttributeListener {
    
    @Override
    public void attributeAdded(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object value = se.getValue();
        System.out.println("â• ä¼šè¯å±æ€§æ·»åŠ ï¼š" + name + " = " + value);
        
        // ç‰¹æ®Šå¤„ç†ç”¨æˆ·ç™»å½•
        if ("user".equals(name)) {
            System.out.println("ğŸ‘¤ ç”¨æˆ·ç™»å½•ï¼š" + value);
        }
    }
    
    @Override
    public void attributeReplaced(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object oldValue = se.getValue(); // æ—§å€¼
        Object newValue = se.getSession().getAttribute(name); // æ–°å€¼
        System.out.println("ğŸ”„ ä¼šè¯å±æ€§ä¿®æ”¹ï¼š" + name + " ä» " + oldValue + " æ”¹ä¸º " + newValue);
    }
    
    @Override
    public void attributeRemoved(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object value = se.getValue();
        System.out.println("â– ä¼šè¯å±æ€§åˆ é™¤ï¼š" + name + " = " + value);
        
        // ç‰¹æ®Šå¤„ç†ç”¨æˆ·æ³¨é”€
        if ("user".equals(name)) {
            System.out.println("ğŸ‘¤ ç”¨æˆ·æ³¨é”€ï¼š" + value);
        }
    }
}
```

---

## 7. âš™ï¸ ç›‘å¬å™¨é…ç½®æ–¹å¼é€‰æ‹©


### 7.1 ä¸¤ç§é…ç½®æ–¹å¼å¯¹æ¯”


**ğŸ“Š é…ç½®æ–¹å¼å¯¹æ¯”è¡¨**

| é…ç½®æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| `@WebListeneræ³¨è§£` | `ç®€å•ä¾¿æ·ï¼Œä»£ç é›†ä¸­` | `éœ€è¦Servlet 3.0+` | `ç°ä»£é¡¹ç›®ï¼Œå¿«é€Ÿå¼€å‘` |
| `web.xmlé…ç½®` | `å…¼å®¹æ€§å¥½ï¼Œé…ç½®çµæ´»` | `é…ç½®ç¹çï¼Œå®¹æ˜“å‡ºé”™` | `è€æ—§é¡¹ç›®ï¼Œå¤æ‚é…ç½®` |

### 7.2 æ³¨è§£é…ç½®æ–¹å¼


**ğŸ”¸ æ³¨è§£é…ç½®ç¤ºä¾‹**
```java
// 1. åº”ç”¨ç›‘å¬å™¨
@WebListener
public class MyContextListener implements ServletContextListener {
    // å®ç°æ–¹æ³•...
}

// 2. ä¼šè¯ç›‘å¬å™¨  
@WebListener
public class MySessionListener implements HttpSessionListener {
    // å®ç°æ–¹æ³•...
}

// 3. è¯·æ±‚ç›‘å¬å™¨
@WebListener  
public class MyRequestListener implements ServletRequestListener {
    // å®ç°æ–¹æ³•...
}
```

**âœ… æ³¨è§£æ–¹å¼ä¼˜ç‚¹**
- ä»£ç ç®€æ´ï¼Œä¸€ä¸ªæ³¨è§£æå®š
- ç±»å’Œé…ç½®åœ¨ä¸€èµ·ï¼Œä¾¿äºç»´æŠ¤
- ä¸éœ€è¦ä¿®æ”¹web.xmlæ–‡ä»¶

### 7.3 XMLé…ç½®æ–¹å¼


**ğŸ”¸ web.xmlé…ç½®ç¤ºä¾‹**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="3.0">
    
    <!-- åº”ç”¨ç›‘å¬å™¨ -->
    <listener>
        <listener-class>com.example.MyContextListener</listener-class>
    </listener>
    
    <!-- ä¼šè¯ç›‘å¬å™¨ -->
    <listener>
        <listener-class>com.example.MySessionListener</listener-class>
    </listener>
    
    <!-- è¯·æ±‚ç›‘å¬å™¨ -->
    <listener>
        <listener-class>com.example.MyRequestListener</listener-class>
    </listener>
    
</web-app>
```

**âœ… XMLæ–¹å¼ä¼˜ç‚¹**
- å…¼å®¹æ‰€æœ‰Servletç‰ˆæœ¬
- é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®
- å¯ä»¥è®¾ç½®ç›‘å¬å™¨é¡ºåº

### 7.4 é…ç½®é€‰æ‹©å»ºè®®


**ğŸ¯ é€‰æ‹©æŒ‡å¯¼åŸåˆ™**

```
æ¨èä½¿ç”¨@WebListeneræ³¨è§£ï¼š
âœ“ æ–°é¡¹ç›®æˆ–ç°ä»£åŒ–é¡¹ç›®
âœ“ ä½¿ç”¨Servlet 3.0+ç‰ˆæœ¬
âœ“ ç›‘å¬å™¨é€»è¾‘ç›¸å¯¹ç®€å•
âœ“ å›¢é˜Ÿç†Ÿæ‚‰æ³¨è§£å¼€å‘

é€‰æ‹©web.xmlé…ç½®ï¼š
âœ“ ç»´æŠ¤è€æ—§é¡¹ç›®
âœ“ ä½¿ç”¨ä½ç‰ˆæœ¬Servlet
âœ“ éœ€è¦å¤æ‚é…ç½®æ§åˆ¶
âœ“ éœ€è¦ä¸¥æ ¼æ§åˆ¶åŠ è½½é¡ºåº
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¹ ç›‘å¬å™¨ä¸‰å‰‘å®¢**
```
ServletContextListenerï¼šåº”ç”¨ç”Ÿå‘½å‘¨æœŸç›‘å¬
- ä½œç”¨èŒƒå›´ï¼šæ•´ä¸ªWebåº”ç”¨
- è§¦å‘æ—¶æœºï¼šåº”ç”¨å¯åŠ¨å’Œå…³é—­
- å…¸å‹ç”¨é€”ï¼šåˆå§‹åŒ–å…¨å±€èµ„æº

HttpSessionListenerï¼šç”¨æˆ·ä¼šè¯ç›‘å¬  
- ä½œç”¨èŒƒå›´ï¼šå•ä¸ªç”¨æˆ·ä¼šè¯
- è§¦å‘æ—¶æœºï¼šä¼šè¯åˆ›å»ºå’Œé”€æ¯
- å…¸å‹ç”¨é€”ï¼šåœ¨çº¿ç”¨æˆ·ç»Ÿè®¡

ServletRequestListenerï¼šè¯·æ±‚ç”Ÿå‘½å‘¨æœŸç›‘å¬
- ä½œç”¨èŒƒå›´ï¼šå•æ¬¡ç”¨æˆ·è¯·æ±‚
- è§¦å‘æ—¶æœºï¼šè¯·æ±‚å¼€å§‹å’Œç»“æŸ
- å…¸å‹ç”¨é€”ï¼šè¯·æ±‚æ—¥å¿—è®°å½•
```

**ğŸ”¹ ç”Ÿå‘½å‘¨æœŸå±‚æ¬¡å…³ç³»**
```
ç”Ÿå‘½å‘¨æœŸé•¿åº¦ï¼šContext > Session > Request
è§¦å‘é¢‘ç‡ï¼šContext < Session < Request

ç†è§£è¦ç‚¹ï¼š
- Contextç›‘å¬å™¨æ•´ä¸ªåº”ç”¨æœŸé—´åªè§¦å‘ä¸€æ¬¡
- Sessionç›‘å¬å™¨æ¯ä¸ªç”¨æˆ·ä¼šè¯è§¦å‘ä¸€æ¬¡
- Requestç›‘å¬å™¨æ¯ä¸ªç”¨æˆ·è¯·æ±‚éƒ½è§¦å‘ä¸€æ¬¡
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ§  ç›‘å¬å™¨å·¥ä½œæœºåˆ¶**
```
äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼š
ç”¨æˆ·æ“ä½œ â†’ è§¦å‘äº‹ä»¶ â†’ è‡ªåŠ¨è°ƒç”¨ç›‘å¬å™¨ â†’ æ‰§è¡Œå¤„ç†é€»è¾‘

ä¼˜åŠ¿ï¼š
- è‡ªåŠ¨å“åº”ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨
- è§£è€¦ä¸šåŠ¡é€»è¾‘å’Œäº‹ä»¶å¤„ç†
- ä¾¿äºå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆæ—¥å¿—ã€ç»Ÿè®¡ç­‰ï¼‰
```

**ğŸ”§ é…ç½®æ–¹å¼é€‰æ‹©**
```
ç°ä»£å¼€å‘æ¨èï¼š@WebListeneræ³¨è§£
- ç®€å•ä¾¿æ·ï¼Œä»£ç é›†ä¸­
- ç¬¦åˆç°ä»£å¼€å‘ä¹ æƒ¯

ç‰¹æ®Šéœ€æ±‚é€‰æ‹©ï¼šweb.xmlé…ç½®  
- å…¼å®¹æ€§è¦æ±‚é«˜
- éœ€è¦å¤æ‚é…ç½®æ§åˆ¶
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯**
```
ç³»ç»Ÿç›‘æ§ç±»ï¼š
- åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡
- ç³»ç»Ÿæ€§èƒ½ç›‘æ§
- è®¿é—®æ—¥å¿—è®°å½•

èµ„æºç®¡ç†ç±»ï¼š
- æ•°æ®åº“è¿æ¥æ± ç®¡ç†
- ç¼“å­˜åˆå§‹åŒ–
- å®šæ—¶ä»»åŠ¡ç®¡ç†

å®‰å…¨æ§åˆ¶ç±»ï¼š
- ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
- å¼‚å¸¸è¯·æ±‚æ£€æµ‹
- ä¼šè¯å®‰å…¨ç®¡ç†
```

### 8.4 å­¦ä¹ æ£€æŸ¥æ¸…å•


**âœ… çŸ¥è¯†æŒæ¡æ£€æŸ¥**
- [ ] èƒ½è¯´å‡ºä¸‰ç§ç›‘å¬å™¨çš„ä½œç”¨å’ŒåŒºåˆ«
- [ ] ç†è§£ç›‘å¬å™¨çš„ç”Ÿå‘½å‘¨æœŸå±‚æ¬¡å…³ç³»
- [ ] æŒæ¡@WebListeneræ³¨è§£çš„ä½¿ç”¨æ–¹æ³•
- [ ] èƒ½ç¼–å†™ç®€å•çš„åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡åŠŸèƒ½
- [ ] äº†è§£å±æ€§å˜åŒ–ç›‘å¬çš„åº”ç”¨åœºæ™¯

**ğŸ¯ å®è·µèƒ½åŠ›æ£€æŸ¥**
- [ ] èƒ½ç‹¬ç«‹åˆ›å»ºåº”ç”¨å¯åŠ¨ç›‘å¬å™¨
- [ ] èƒ½å®ç°ä¼šè¯ç»Ÿè®¡åŠŸèƒ½
- [ ] èƒ½é…ç½®è¯·æ±‚æ—¥å¿—ç›‘å¬å™¨
- [ ] èƒ½é€‰æ‹©åˆé€‚çš„é…ç½®æ–¹å¼
- [ ] èƒ½å¤„ç†ç›‘å¬å™¨ä¸­çš„å¼‚å¸¸æƒ…å†µ

### 8.5 è®°å¿†å¼ºåŒ–


**ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**
```
ä¸‰å¤§ç›‘å¬åˆ†å±‚æ¬¡ï¼Œåº”ç”¨ä¼šè¯åŠ è¯·æ±‚
Contextç®¡å…¨å±€ï¼ŒSessionç®¡ç”¨æˆ·ï¼ŒRequestç®¡è®¿é—®
æ³¨è§£é…ç½®æœ€ç®€å•ï¼ŒXMLå…¼å®¹æ€§æ›´å¥½
äº‹ä»¶é©±åŠ¨è‡ªåŠ¨è·‘ï¼Œæ¨ªåˆ‡å…³æ³¨ç‚¹å¤„ç†å¦™
```

**ğŸ¯ ä¸€å¥è¯ç²¾å**
ç›‘å¬å™¨æ˜¯Webåº”ç”¨çš„"å®ˆæŠ¤è€…"ï¼Œé»˜é»˜ç›‘æ§ç€åº”ç”¨ã€ç”¨æˆ·å’Œè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å…³é”®æ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œå¿…è¦çš„å¤„ç†é€»è¾‘ã€‚

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šç›‘å¬å™¨æ˜¯å®ç°ç³»ç»Ÿç›‘æ§å’Œèµ„æºç®¡ç†çš„é‡è¦å·¥å…·ï¼Œå»ºè®®é€šè¿‡å®é™…é¡¹ç›®ç»ƒä¹ æ¥æ·±å…¥ç†è§£å…¶åº”ç”¨ä»·å€¼ã€‚ä»ç®€å•çš„åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡å¼€å§‹ï¼Œé€æ­¥æ‰©å±•åˆ°æ›´å¤æ‚çš„ç³»ç»Ÿç›‘æ§åŠŸèƒ½ã€‚