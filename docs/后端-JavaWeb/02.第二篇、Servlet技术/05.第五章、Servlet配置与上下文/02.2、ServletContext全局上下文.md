---
title: 2ã€ServletContextå…¨å±€ä¸Šä¸‹æ–‡
---
## ğŸ“š ç›®å½•

1. [ServletContextåŸºæœ¬æ¦‚å¿µ](#1-ServletContextåŸºæœ¬æ¦‚å¿µ)
2. [å…¨å±€åˆå§‹åŒ–å‚æ•°é…ç½®](#2-å…¨å±€åˆå§‹åŒ–å‚æ•°é…ç½®)
3. [èµ„æºæ–‡ä»¶è®¿é—®æ“ä½œ](#3-èµ„æºæ–‡ä»¶è®¿é—®æ“ä½œ)
4. [å±æ€§å­˜å‚¨ä¸å…±äº«æœºåˆ¶](#4-å±æ€§å­˜å‚¨ä¸å…±äº«æœºåˆ¶)
5. [ç”Ÿå‘½å‘¨æœŸç®¡ç†è¯¦è§£](#5-ç”Ÿå‘½å‘¨æœŸç®¡ç†è¯¦è§£)
6. [å•ä¾‹ç‰¹æ€§æ·±å…¥ç†è§£](#6-å•ä¾‹ç‰¹æ€§æ·±å…¥ç†è§£)
7. [å®æˆ˜åº”ç”¨åœºæ™¯](#7-å®æˆ˜åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ServletContextåŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ServletContext


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
```
æƒ³è±¡ä¸€ä¸ªå¤§å‹è´­ç‰©ä¸­å¿ƒï¼š
- æ¯ä¸ªå•†é“º = å•ä¸ªServlet
- è´­ç‰©ä¸­å¿ƒçš„ç®¡ç†ä¸­å¿ƒ = ServletContext
- ç®¡ç†ä¸­å¿ƒè´Ÿè´£ï¼šç»Ÿä¸€ç®¡ç†ã€ä¿¡æ¯å…±äº«ã€èµ„æºè°ƒé…

ServletContextå°±æ˜¯æ•´ä¸ªWebåº”ç”¨çš„"ç®¡ç†ä¸­å¿ƒ"
```

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
ServletContextæ˜¯Webåº”ç”¨ç¨‹åºçš„å…¨å±€ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå®ƒä»£è¡¨æ•´ä¸ªWebåº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒã€‚ç®€å•è¯´ï¼Œå°±æ˜¯**æ•´ä¸ªç½‘ç«™çš„"å¤§ç®¡å®¶"**ã€‚

### 1.2 ServletContextçš„ä½œç”¨èŒƒå›´


**ğŸ“Š ä½œç”¨åŸŸå¯¹æ¯”**

| ä½œç”¨åŸŸç±»å‹ | **èŒƒå›´** | **ç”Ÿå‘½å‘¨æœŸ** | **å…¸å‹ç”¨é€”** |
|-----------|----------|-------------|-------------|
| ğŸ”¸ **ServletContext** | `æ•´ä¸ªWebåº”ç”¨` | `åº”ç”¨å¯åŠ¨åˆ°å…³é—­` | `å…¨å±€é…ç½®ã€èµ„æºå…±äº«` |
| ğŸ”¹ **HttpSession** | `å•ä¸ªç”¨æˆ·ä¼šè¯` | `ä¼šè¯å¼€å§‹åˆ°ç»“æŸ` | `ç”¨æˆ·çŠ¶æ€ã€è´­ç‰©è½¦` |
| ğŸ”¹ **ServletRequest** | `å•æ¬¡è¯·æ±‚` | `è¯·æ±‚å¼€å§‹åˆ°å“åº”` | `è¯·æ±‚å‚æ•°ã€ä¸´æ—¶æ•°æ®` |

### 1.3 è·å–ServletContextçš„æ–¹å¼


**ğŸ”§ å¸¸ç”¨è·å–æ–¹æ³•**
```java
// æ–¹å¼1ï¼šé€šè¿‡Servletè·å–ï¼ˆæ¨èï¼‰
ServletContext context = this.getServletContext();

// æ–¹å¼2ï¼šé€šè¿‡HttpServletRequestè·å–
ServletContext context = request.getServletContext();

// æ–¹å¼3ï¼šé€šè¿‡HttpSessionè·å–
ServletContext context = session.getServletContext();
```

> âš ï¸ **é‡è¦æé†’**ï¼šæ— è®ºé€šè¿‡å“ªç§æ–¹å¼è·å–ï¼Œå¾—åˆ°çš„éƒ½æ˜¯**åŒä¸€ä¸ªå¯¹è±¡**ï¼Œå› ä¸ºæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªServletContextå®ä¾‹ã€‚

---

## 2. âš™ï¸ å…¨å±€åˆå§‹åŒ–å‚æ•°é…ç½®


### 2.1 ä»€ä¹ˆæ˜¯å…¨å±€åˆå§‹åŒ–å‚æ•°


**ğŸ’¡ ç”Ÿæ´»åœºæ™¯ç±»æ¯”**ï¼š
```
å…¨å±€åˆå§‹åŒ–å‚æ•° = è´­ç‰©ä¸­å¿ƒçš„åŸºæœ¬é…ç½®ä¿¡æ¯
- è¥ä¸šæ—¶é—´ï¼š9:00-22:00
- å®¢æœç”µè¯ï¼š400-123-4567  
- åœè½¦æ”¶è´¹ï¼šæ¯å°æ—¶5å…ƒ

è¿™äº›ä¿¡æ¯æ‰€æœ‰å•†é“ºéƒ½éœ€è¦çŸ¥é“ï¼Œç»Ÿä¸€ç®¡ç†
```

**ğŸ”¸ æŠ€æœ¯å®šä¹‰**
å…¨å±€åˆå§‹åŒ–å‚æ•°æ˜¯åœ¨`web.xml`ä¸­é…ç½®çš„ã€ä¾›æ•´ä¸ªWebåº”ç”¨ä½¿ç”¨çš„å‚æ•°ï¼Œæ‰€æœ‰Servletéƒ½å¯ä»¥è®¿é—®ã€‚

### 2.2 é…ç½®å…¨å±€åˆå§‹åŒ–å‚æ•°


**ğŸ“ åœ¨web.xmlä¸­é…ç½®**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app>
    <!-- å…¨å±€åˆå§‹åŒ–å‚æ•° -->
    <context-param>
        <param-name>database.driver</param-name>
        <param-value>com.mysql.cj.jdbc.Driver</param-value>
    </context-param>
    
    <context-param>
        <param-name>database.url</param-name>
        <param-value>jdbc:mysql://localhost:3306/mydb</param-value>
    </context-param>
    
    <context-param>
        <param-name>system.version</param-name>
        <param-value>1.0.0</param-value>
    </context-param>
</web-app>
```

### 2.3 è¯»å–å…¨å±€åˆå§‹åŒ–å‚æ•°


**ğŸ” è·å–å‚æ•°çš„æ–¹æ³•**
```java
public class ConfigServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        // è·å–ServletContext
        ServletContext context = getServletContext();
        
        // è·å–å•ä¸ªå‚æ•°
        String driver = context.getInitParameter("database.driver");
        String url = context.getInitParameter("database.url");
        String version = context.getInitParameter("system.version");
        
        // è·å–æ‰€æœ‰å‚æ•°åç§°
        Enumeration<String> names = context.getInitParameterNames();
        
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        
        out.println("<h2>å…¨å±€é…ç½®ä¿¡æ¯</h2>");
        out.println("æ•°æ®åº“é©±åŠ¨ï¼š" + driver + "<br>");
        out.println("æ•°æ®åº“åœ°å€ï¼š" + url + "<br>");
        out.println("ç³»ç»Ÿç‰ˆæœ¬ï¼š" + version + "<br>");
    }
}
```

### 2.4 å…¨å±€å‚æ•° vs Servletåˆå§‹åŒ–å‚æ•°


**ğŸ“Š ä¸¤è€…å¯¹æ¯”**

```
å…¨å±€åˆå§‹åŒ–å‚æ•°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ServletContext â”‚ â† æ‰€æœ‰Servletéƒ½èƒ½è®¿é—®
â”‚   â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”   â”‚
â”‚   â”‚S1 â”‚ â”‚S2 â”‚   â”‚ â† Servlet1, Servlet2
â”‚   â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Servletåˆå§‹åŒ–å‚æ•°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ServletContext â”‚
â”‚   â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”   â”‚
â”‚   â”‚S1 â”‚ â”‚S2 â”‚   â”‚ â† æ¯ä¸ªServletæœ‰è‡ªå·±çš„å‚æ•°
â”‚   â”‚ğŸ“‹ â”‚ â”‚ğŸ“‹ â”‚   â”‚
â”‚   â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸ“ èµ„æºæ–‡ä»¶è®¿é—®æ“ä½œ


### 3.1 Webåº”ç”¨çš„èµ„æºç»“æ„


**ğŸ—‚ï¸ å…¸å‹çš„Webåº”ç”¨ç›®å½•ç»“æ„**
```
MyWebApp/
â”œâ”€â”€ WEB-INF/
â”‚   â”œâ”€â”€ web.xml
â”‚   â”œâ”€â”€ classes/          â† Javaç±»æ–‡ä»¶
â”‚   â””â”€â”€ lib/              â† JARåº“æ–‡ä»¶
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ database.properties
â”‚   â””â”€â”€ system.properties
â””â”€â”€ index.html
```

### 3.2 getResourceAsStream()æ–¹æ³•è¯¦è§£


**ğŸ’¡ æ–¹æ³•ä½œç”¨**ï¼š
`getResourceAsStream()`æ–¹æ³•å¯ä»¥è·å–Webåº”ç”¨ä¸­ä»»ä½•èµ„æºæ–‡ä»¶çš„è¾“å…¥æµï¼Œ**è·¯å¾„ç›¸å¯¹äºWebåº”ç”¨æ ¹ç›®å½•**ã€‚

**ğŸ”§ åŸºæœ¬ç”¨æ³•ç¤ºä¾‹**
```java
public class ResourceServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        ServletContext context = getServletContext();
        
        // è·å–é…ç½®æ–‡ä»¶æµï¼ˆè·¯å¾„ä»¥/å¼€å¤´ï¼Œç›¸å¯¹äºWebåº”ç”¨æ ¹ç›®å½•ï¼‰
        InputStream is = context.getResourceAsStream("/config/database.properties");
        
        if (is != null) {
            // è¯»å–propertiesæ–‡ä»¶
            Properties props = new Properties();
            props.load(is);
            
            // è·å–é…ç½®å€¼
            String username = props.getProperty("username");
            String password = props.getProperty("password");
            
            // å…³é—­æµ
            is.close();
            
            response.getWriter().println("ç”¨æˆ·åï¼š" + username);
        } else {
            response.getWriter().println("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼");
        }
    }
}
```

### 3.3 è·¯å¾„è§„åˆ™è¯¦è§£


**ğŸ” è·¯å¾„è§„åˆ™è¯´æ˜**

```
ç»å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰ï¼šä»¥ / å¼€å¤´
/config/database.properties    â† ç›¸å¯¹äºWebåº”ç”¨æ ¹ç›®å½•
/static/images/logo.jpg        â† ç›¸å¯¹äºWebåº”ç”¨æ ¹ç›®å½•
/WEB-INF/classes/MyClass.class â† å¯ä»¥è®¿é—®WEB-INFä¸‹çš„èµ„æº

ç›¸å¯¹è·¯å¾„ï¼šä¸ä»¥ / å¼€å¤´  
config/database.properties     â† ç›¸å¯¹äºå½“å‰ä½ç½®ï¼ˆä¸æ¨èï¼‰
```

> âš ï¸ **é‡è¦æé†’**ï¼šæ¨èä½¿ç”¨**ç»å¯¹è·¯å¾„**ï¼ˆä»¥/å¼€å¤´ï¼‰ï¼Œè¿™æ ·ä¸ä¼šå—å½“å‰ä½ç½®å½±å“ï¼Œæ›´åŠ å¯é ã€‚

### 3.4 å®ç”¨å·¥å…·ç±»å°è£…


**ğŸ› ï¸ èµ„æºè®¿é—®å·¥å…·ç±»**
```java
public class ResourceUtil {
    
    // è¯»å–Propertiesæ–‡ä»¶
    public static Properties loadProperties(String path) {
        ServletContext context = /* è·å–contextçš„æ–¹å¼ */;
        Properties props = new Properties();
        
        try (InputStream is = context.getResourceAsStream(path)) {
            if (is != null) {
                props.load(is);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        
        return props;
    }
    
    // è¯»å–æ–‡æœ¬æ–‡ä»¶
    public static String loadTextFile(String path) {
        ServletContext context = /* è·å–contextçš„æ–¹å¼ */;
        StringBuilder sb = new StringBuilder();
        
        try (InputStream is = context.getResourceAsStream(path);
             BufferedReader reader = new BufferedReader(
                 new InputStreamReader(is, "UTF-8"))) {
            
            String line;
            while ((line = reader.readLine()) != null) {
                sb.append(line).append("\n");
            }
            
        } catch (IOException e) {
            e.printStackTrace();
        }
        
        return sb.toString();
    }
}
```

---

## 4. ğŸ—„ï¸ å±æ€§å­˜å‚¨ä¸å…±äº«æœºåˆ¶


### 4.1 å±æ€§å­˜å‚¨çš„æ¦‚å¿µ


**ğŸ’¡ ç”Ÿæ´»åœºæ™¯ç±»æ¯”**ï¼š
```
ServletContextçš„å±æ€§å­˜å‚¨ = è´­ç‰©ä¸­å¿ƒçš„å…¬å‘Šæ¿
- ä»»ä½•å•†é“ºéƒ½å¯ä»¥åœ¨ä¸Šé¢è´´å…¬å‘Š
- æ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°å…¬å‘Šå†…å®¹  
- å…¬å‘Šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æœ‰äººæ’¤æ‰

å±æ€§å°±æ˜¯åœ¨"å…¬å‘Šæ¿"ä¸Šè´´çš„"ä¾¿æ¡"
```

**ğŸ”¸ æŠ€æœ¯å®šä¹‰**
ServletContextå±æ€§æ˜¯å­˜å‚¨åœ¨åº”ç”¨ç¨‹åºä½œç”¨åŸŸä¸­çš„é”®å€¼å¯¹æ•°æ®ï¼Œæ‰€æœ‰Servletéƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹ã€‚

### 4.2 å±æ€§æ“ä½œæ–¹æ³•


**ğŸ“‹ æ ¸å¿ƒAPIæ–¹æ³•**

| æ–¹æ³•å | **ä½œç”¨** | **å‚æ•°è¯´æ˜** |
|--------|---------|-------------|
| `setAttribute(String name, Object value)` | `å­˜å‚¨å±æ€§` | `name:å±æ€§å, value:å±æ€§å€¼` |
| `getAttribute(String name)` | `è·å–å±æ€§` | `name:å±æ€§å` |
| `removeAttribute(String name)` | `åˆ é™¤å±æ€§` | `name:å±æ€§å` |
| `getAttributeNames()` | `è·å–æ‰€æœ‰å±æ€§å` | `è¿”å›Enumeration` |

### 4.3 å±æ€§æ“ä½œå®ä¾‹


**ğŸ”§ åŸºæœ¬æ“ä½œç¤ºä¾‹**
```java
// Servlet Aï¼šå­˜å‚¨æ•°æ®
public class DataStoreServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        ServletContext context = getServletContext();
        
        // å­˜å‚¨å„ç§ç±»å‹çš„æ•°æ®
        context.setAttribute("visitCount", 0);
        context.setAttribute("systemStartTime", new Date());
        context.setAttribute("configData", loadConfigData());
        
        response.getWriter().println("æ•°æ®å·²å­˜å‚¨åˆ°åº”ç”¨ä¸Šä¸‹æ–‡");
    }
}

// Servlet Bï¼šè¯»å–æ•°æ®
public class DataReadServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        ServletContext context = getServletContext();
        
        // è¯»å–æ•°æ®
        Integer visitCount = (Integer) context.getAttribute("visitCount");
        Date startTime = (Date) context.getAttribute("systemStartTime");
        
        // ä¿®æ”¹æ•°æ®
        if (visitCount != null) {
            context.setAttribute("visitCount", visitCount + 1);
        }
        
        response.setContentType("text/html;charset=UTF-8");
        response.getWriter().println("è®¿é—®æ¬¡æ•°ï¼š" + (visitCount + 1) + "<br>");
        response.getWriter().println("ç³»ç»Ÿå¯åŠ¨æ—¶é—´ï¼š" + startTime);
    }
}
```

### 4.4 çº¿ç¨‹å®‰å…¨é—®é¢˜


**âš ï¸ å¹¶å‘è®¿é—®é£é™©**
```
å¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—® â†’ å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹å±æ€§ â†’ å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´

å±é™©ç¤ºä¾‹ï¼š
çº¿ç¨‹Aè¯»å– visitCount = 100
çº¿ç¨‹Bè¯»å– visitCount = 100  
çº¿ç¨‹Aè®¾ç½® visitCount = 101
çº¿ç¨‹Bè®¾ç½® visitCount = 101  â† åº”è¯¥æ˜¯102ï¼
```

**ğŸ”’ çº¿ç¨‹å®‰å…¨è§£å†³æ–¹æ¡ˆ**
```java
public class SafeCounterServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        ServletContext context = getServletContext();
        
        // æ–¹æ¡ˆ1ï¼šä½¿ç”¨synchronizedåŒæ­¥
        synchronized (context) {
            Integer count = (Integer) context.getAttribute("visitCount");
            if (count == null) count = 0;
            context.setAttribute("visitCount", count + 1);
        }
        
        // æ–¹æ¡ˆ2ï¼šä½¿ç”¨AtomicIntegerï¼ˆæ¨èï¼‰
        AtomicInteger atomicCount = (AtomicInteger) context.getAttribute("atomicCount");
        if (atomicCount == null) {
            atomicCount = new AtomicInteger(0);
            context.setAttribute("atomicCount", atomicCount);
        }
        int currentCount = atomicCount.incrementAndGet();
        
        response.getWriter().println("å®‰å…¨è®¡æ•°ï¼š" + currentCount);
    }
}
```

---

## 5. â° ç”Ÿå‘½å‘¨æœŸç®¡ç†è¯¦è§£


### 5.1 ServletContextç”Ÿå‘½å‘¨æœŸæ¦‚è¿°


**ğŸ“Š ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ**
```
Webåº”ç”¨å¯åŠ¨                    Webåº”ç”¨å…³é—­
      â†“                          â†“
   åˆ›å»ºServletContext --------â†’ é”€æ¯ServletContext
      â†“                          â†‘
   åˆå§‹åŒ–å…¨å±€èµ„æº                 æ¸…ç†å…¨å±€èµ„æº
      â†“                          â†‘
   æœåŠ¡è¯·æ±‚é˜¶æ®µ â†-----------------â”˜
```

### 5.2 ç”Ÿå‘½å‘¨æœŸå„é˜¶æ®µè¯¦è§£


**ğŸ”¸ åˆ›å»ºé˜¶æ®µï¼ˆåº”ç”¨å¯åŠ¨æ—¶ï¼‰**
- â° **æ—¶æœº**ï¼šWebåº”ç”¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶
- ğŸ¯ **æ“ä½œ**ï¼šè¯»å–web.xmlé…ç½®ï¼Œåˆ›å»ºServletContextå®ä¾‹
- ğŸ“ **ç‰¹ç‚¹**ï¼šæ•´ä¸ªåº”ç”¨åªåˆ›å»ºä¸€æ¬¡

**ğŸ”¸ æœåŠ¡é˜¶æ®µï¼ˆåº”ç”¨è¿è¡Œæ—¶ï¼‰**  
- â° **æ—¶æœº**ï¼šå¤„ç†ç”¨æˆ·è¯·æ±‚æœŸé—´
- ğŸ¯ **æ“ä½œ**ï¼šæä¾›å…¨å±€é…ç½®ã€èµ„æºè®¿é—®ã€å±æ€§å­˜å‚¨æœåŠ¡
- ğŸ“ **ç‰¹ç‚¹**ï¼šæŒç»­åˆ°åº”ç”¨å…³é—­

**ğŸ”¸ é”€æ¯é˜¶æ®µï¼ˆåº”ç”¨å…³é—­æ—¶ï¼‰**
- â° **æ—¶æœº**ï¼šWebåº”ç”¨å…³é—­æˆ–æœåŠ¡å™¨åœæ­¢æ—¶
- ğŸ¯ **æ“ä½œ**ï¼šæ¸…ç†èµ„æºï¼Œé‡Šæ”¾å†…å­˜
- ğŸ“ **ç‰¹ç‚¹**ï¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„

### 5.3 ç›‘å¬ServletContextç”Ÿå‘½å‘¨æœŸ


**ğŸ” ServletContextListeneræ¥å£**
```java
// ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨
public class AppLifecycleListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("=== Webåº”ç”¨å¯åŠ¨ ===");
        
        ServletContext context = sce.getServletContext();
        
        // åˆå§‹åŒ–å…¨å±€èµ„æº
        initializeGlobalResources(context);
        
        // è®°å½•å¯åŠ¨æ—¶é—´
        context.setAttribute("startTime", new Date());
        
        System.out.println("åº”ç”¨åˆå§‹åŒ–å®Œæˆ");
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("=== Webåº”ç”¨å…³é—­ ===");
        
        ServletContext context = sce.getServletContext();
        
        // æ¸…ç†èµ„æº
        cleanupResources(context);
        
        System.out.println("åº”ç”¨æ¸…ç†å®Œæˆ");
    }
    
    private void initializeGlobalResources(ServletContext context) {
        // åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
        // åŠ è½½é…ç½®æ–‡ä»¶
        // åˆå§‹åŒ–ç¼“å­˜
        context.setAttribute("initialized", true);
    }
    
    private void cleanupResources(ServletContext context) {
        // å…³é—­æ•°æ®åº“è¿æ¥
        // æ¸…ç†ç¼“å­˜
        // ä¿å­˜é‡è¦æ•°æ®
    }
}
```

**ğŸ“ åœ¨web.xmlä¸­æ³¨å†Œç›‘å¬å™¨**
```xml
<web-app>
    <listener>
        <listener-class>com.example.AppLifecycleListener</listener-class>
    </listener>
</web-app>
```

---

## 6. ğŸ”’ å•ä¾‹ç‰¹æ€§æ·±å…¥ç†è§£


### 6.1 å•ä¾‹ç‰¹æ€§è§£é‡Š


**ğŸ’¡ å•ä¾‹æ¨¡å¼ç±»æ¯”**ï¼š
```
ServletContextçš„å•ä¾‹ç‰¹æ€§ = ä¸€ä¸ªåŸå¸‚åªæœ‰ä¸€ä¸ªå¸‚æ”¿åºœ
- ä¸ç®¡ä»å“ªä¸ªåŒºè®¿é—®å¸‚æ”¿åºœï¼Œéƒ½æ˜¯åŒä¸€ä¸ª
- æ‰€æœ‰åŒºåŸŸå…±äº«å¸‚æ”¿åºœçš„æœåŠ¡å’Œèµ„æº
- å¸‚æ”¿åºœç»Ÿä¸€ç®¡ç†æ•´ä¸ªåŸå¸‚

ä¸€ä¸ªWebåº”ç”¨åªæœ‰ä¸€ä¸ªServletContextå®ä¾‹
```

### 6.2 å•ä¾‹ç‰¹æ€§éªŒè¯


**ğŸ” éªŒè¯ä»£ç ç¤ºä¾‹**
```java
// Servlet A
public class ServletA extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        ServletContext context1 = getServletContext();
        ServletContext context2 = request.getServletContext();
        
        response.getWriter().println("ServletAä¸­çš„context1: " + context1.hashCode() + "<br>");
        response.getWriter().println("ServletAä¸­çš„context2: " + context2.hashCode() + "<br>");
        response.getWriter().println("ä¸¤è€…ç›¸ç­‰: " + (context1 == context2) + "<br>");
        
        // å­˜å‚¨ä¸€ä¸ªå±æ€§
        context1.setAttribute("testData", "æ¥è‡ªServletA");
    }
}

// Servlet B  
public class ServletB extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws ServletException, IOException {
        
        ServletContext context = getServletContext();
        
        response.getWriter().println("ServletBä¸­çš„context: " + context.hashCode() + "<br>");
        
        // è¯»å–ServletAå­˜å‚¨çš„å±æ€§
        String testData = (String) context.getAttribute("testData");
        response.getWriter().println("è¯»å–åˆ°çš„æ•°æ®: " + testData + "<br>");
    }
}
```

> âœ… **éªŒè¯ç»“æœ**ï¼šæ— è®ºåœ¨å“ªä¸ªServletä¸­è·å–ï¼ŒServletContextçš„hashCodeéƒ½ç›¸åŒï¼Œè¯´æ˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚

### 6.3 å•ä¾‹ç‰¹æ€§çš„ä¼˜åŠ¿


**ğŸ¯ ä¼˜åŠ¿åˆ†æ**

| ä¼˜åŠ¿ç±»å‹ | **å…·ä½“è¡¨ç°** | **å®é™…ä»·å€¼** |
|---------|-------------|-------------|
| ğŸ”¸ **å†…å­˜æ•ˆç‡** | `åªæœ‰ä¸€ä¸ªå®ä¾‹` | `èŠ‚çœå†…å­˜ç©ºé—´` |
| ğŸ”¸ **æ•°æ®å…±äº«** | `å…¨å±€å±æ€§å…±äº«` | `ç»„ä»¶é—´é€šä¿¡ä¾¿åˆ©` |  
| ğŸ”¸ **é…ç½®ç»Ÿä¸€** | `å…¨å±€é…ç½®ç®¡ç†` | `ç»´æŠ¤ç®€å•ï¼Œé¿å…å†²çª` |
| ğŸ”¸ **èµ„æºç®¡ç†** | `ç»Ÿä¸€èµ„æºè®¿é—®` | `é¿å…é‡å¤åˆ›å»ºï¼Œæé«˜æ•ˆç‡` |

### 6.4 ä½¿ç”¨æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦æé†’**

```
âœ… é€‚åˆå­˜å‚¨çš„æ•°æ®ï¼š
- å…¨å±€é…ç½®ä¿¡æ¯
- å…±äº«çš„å·¥å…·ç±»å®ä¾‹  
- åº”ç”¨çº§åˆ«çš„ç»Ÿè®¡æ•°æ®
- ç¼“å­˜æ•°æ®

âŒ ä¸é€‚åˆå­˜å‚¨çš„æ•°æ®ï¼š
- ç”¨æˆ·ç›¸å…³çš„ä¸ªäººä¿¡æ¯ (åº”è¯¥ç”¨Session)
- è¯·æ±‚ç›¸å…³çš„ä¸´æ—¶æ•°æ® (åº”è¯¥ç”¨Request)
- é¢‘ç¹å˜åŒ–çš„æ•°æ® (è€ƒè™‘çº¿ç¨‹å®‰å…¨)
- å¤§é‡æ•°æ® (ä¼šå ç”¨å¤§é‡å†…å­˜)
```

---

## 7. ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯


### 7.1 åº”ç”¨åœºæ™¯æ¦‚è§ˆ


**ğŸ“‹ å¸¸è§åº”ç”¨åœºæ™¯**

| åœºæ™¯åˆ†ç±» | **å…·ä½“åº”ç”¨** | **ä½¿ç”¨æ–¹å¼** |
|---------|-------------|-------------|
| ğŸ”§ **é…ç½®ç®¡ç†** | `æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°` | `å…¨å±€åˆå§‹åŒ–å‚æ•°` |
| ğŸ“Š **æ•°æ®å…±äº«** | `è®¿é—®ç»Ÿè®¡ã€åœ¨çº¿ç”¨æˆ·æ•°` | `å±æ€§å­˜å‚¨` |
| ğŸ“ **èµ„æºè®¿é—®** | `é…ç½®æ–‡ä»¶ã€æ¨¡æ¿æ–‡ä»¶` | `getResourceAsStream()` |
| ğŸ”„ **ç»„ä»¶é€šä¿¡** | `Servleté—´æ•°æ®ä¼ é€’` | `å±æ€§å­˜å‚¨` |

### 7.2 åœºæ™¯1ï¼šå…¨å±€é…ç½®ç®¡ç†ç³»ç»Ÿ


**ğŸ”§ å®ç°ä¸€ä¸ªé…ç½®ç®¡ç†å™¨**
```java
public class ConfigManager {
    private static final String CONFIG_KEY = "APP_CONFIG";
    
    // åˆå§‹åŒ–é…ç½®ï¼ˆåœ¨ç›‘å¬å™¨ä¸­è°ƒç”¨ï¼‰
    public static void initConfig(ServletContext context) {
        Properties config = new Properties();
        
        // ä»web.xmlè¯»å–å‚æ•°
        config.setProperty("db.driver", context.getInitParameter("database.driver"));
        config.setProperty("db.url", context.getInitParameter("database.url"));
        
        // ä»é…ç½®æ–‡ä»¶è¯»å–
        try (InputStream is = context.getResourceAsStream("/config/app.properties")) {
            if (is != null) {
                Properties fileConfig = new Properties();
                fileConfig.load(is);
                config.putAll(fileConfig);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        
        // å­˜å‚¨åˆ°ServletContext
        context.setAttribute(CONFIG_KEY, config);
    }
    
    // è·å–é…ç½®å€¼
    public static String getConfig(ServletContext context, String key) {
        Properties config = (Properties) context.getAttribute(CONFIG_KEY);
        return config != null ? config.getProperty(key) : null;
    }
}
```

### 7.3 åœºæ™¯2ï¼šè®¿é—®ç»Ÿè®¡ç³»ç»Ÿ


**ğŸ“Š å®ç°è®¿é—®è®¡æ•°å™¨**
```java
public class VisitCounterFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        ServletContext context = httpRequest.getServletContext();
        
        // çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨
        AtomicLong totalVisits = (AtomicLong) context.getAttribute("totalVisits");
        if (totalVisits == null) {
            totalVisits = new AtomicLong(0);
            context.setAttribute("totalVisits", totalVisits);
        }
        
        // å¢åŠ è®¿é—®æ¬¡æ•°
        long currentCount = totalVisits.incrementAndGet();
        
        // è®°å½•è®¿é—®ä¿¡æ¯
        String clientIP = httpRequest.getRemoteAddr();
        String requestURI = httpRequest.getRequestURI();
        
        System.out.println("è®¿é—®æ¬¡æ•°: " + currentCount + 
                          ", IP: " + clientIP + 
                          ", URI: " + requestURI);
        
        chain.doFilter(request, response);
    }
}
```

### 7.4 åœºæ™¯3ï¼šæ–‡ä»¶æ¨¡æ¿ç³»ç»Ÿ


**ğŸ“„ å®ç°æ¨¡æ¿åŠ è½½å™¨**
```java
public class TemplateLoader {
    private static final String TEMPLATE_CACHE = "TEMPLATE_CACHE";
    
    public static String loadTemplate(ServletContext context, String templateName) {
        // å…ˆä»ç¼“å­˜è·å–
        Map<String, String> cache = getTemplateCache(context);
        String template = cache.get(templateName);
        
        if (template == null) {
            // ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œä»æ–‡ä»¶åŠ è½½
            template = loadFromFile(context, templateName);
            if (template != null) {
                cache.put(templateName, template);
            }
        }
        
        return template;
    }
    
    private static Map<String, String> getTemplateCache(ServletContext context) {
        @SuppressWarnings("unchecked")
        Map<String, String> cache = (Map<String, String>) context.getAttribute(TEMPLATE_CACHE);
        if (cache == null) {
            cache = new ConcurrentHashMap<>();
            context.setAttribute(TEMPLATE_CACHE, cache);
        }
        return cache;
    }
    
    private static String loadFromFile(ServletContext context, String templateName) {
        String path = "/templates/" + templateName + ".html";
        
        try (InputStream is = context.getResourceAsStream(path);
             Scanner scanner = new Scanner(is, "UTF-8")) {
            
            return scanner.useDelimiter("\\A").next();
            
        } catch (Exception e) {
            System.err.println("åŠ è½½æ¨¡æ¿å¤±è´¥: " + templateName);
            return null;
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ServletContextæœ¬è´¨ï¼šWebåº”ç”¨çš„å…¨å±€ä¸Šä¸‹æ–‡ï¼Œæ•´ä¸ªåº”ç”¨çš„"å¤§ç®¡å®¶"
ğŸ”¸ åº”ç”¨ç¨‹åºä½œç”¨åŸŸï¼šè¦†ç›–æ•´ä¸ªWebåº”ç”¨ï¼Œæ‰€æœ‰Servletå…±äº«
ğŸ”¸ å…¨å±€åˆå§‹åŒ–å‚æ•°ï¼šweb.xmlä¸­é…ç½®çš„<context-param>ï¼Œä¾›å…¨å±€ä½¿ç”¨
ğŸ”¸ èµ„æºæ–‡ä»¶è®¿é—®ï¼šgetResourceAsStream()æ–¹æ³•ï¼Œè·¯å¾„ç›¸å¯¹äºWebåº”ç”¨æ ¹ç›®å½•
ğŸ”¸ å±æ€§å­˜å‚¨å…±äº«ï¼šsetAttribute/getAttributeï¼Œå®ç°ç»„ä»¶é—´æ•°æ®å…±äº«
ğŸ”¸ ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šåº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œå…³é—­æ—¶é”€æ¯ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸåªæœ‰ä¸€ä¸ªå®ä¾‹
ğŸ”¸ å•ä¾‹ç‰¹æ€§ï¼šæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªServletContextå®ä¾‹ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ServletContext vs å…¶ä»–ä½œç”¨åŸŸ**
```
é€‰æ‹©åŸåˆ™ï¼š
- å…¨åº”ç”¨å…±äº« â†’ ServletContext
- ç”¨æˆ·ä¼šè¯æ•°æ® â†’ HttpSession  
- å•æ¬¡è¯·æ±‚æ•°æ® â†’ ServletRequest
- å±€éƒ¨å˜é‡ â†’ æ–¹æ³•å†…å˜é‡
```

**ğŸ”¹ çº¿ç¨‹å®‰å…¨è€ƒè™‘**
```
é£é™©åœºæ™¯ï¼š
- å¤šç”¨æˆ·åŒæ—¶è®¿é—®ä¿®æ”¹åŒä¸€å±æ€§
- è®¡æ•°å™¨ç±»å‹çš„æ•°æ®æ“ä½œ
- å…±äº«å¯¹è±¡çš„çŠ¶æ€ä¿®æ”¹

è§£å†³æ–¹æ¡ˆï¼š
- ä½¿ç”¨synchronizedåŒæ­¥
- ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ç±»(AtomicIntegerç­‰)
- é¿å…å­˜å‚¨å¯å˜å¯¹è±¡
```

**ğŸ”¹ èµ„æºè·¯å¾„è§„åˆ™**
```
è·¯å¾„æ ¼å¼ï¼š
âœ… ç»å¯¹è·¯å¾„ï¼š/config/app.properties (æ¨è)
âŒ ç›¸å¯¹è·¯å¾„ï¼šconfig/app.properties (ä¸æ¨è)

è®°å¿†è¦ç‚¹ï¼š
- ä»¥/å¼€å¤´ï¼Œç›¸å¯¹äºWebåº”ç”¨æ ¹ç›®å½•
- å¯ä»¥è®¿é—®WEB-INFä¸‹çš„å—ä¿æŠ¤èµ„æº
- ä¸å—å½“å‰ä½ç½®å½±å“ï¼Œæ›´åŠ å¯é 
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯**
- **é…ç½®ç®¡ç†**ï¼šæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°ç»Ÿä¸€ç®¡ç†
- **æ•°æ®å…±äº«**ï¼šç»„ä»¶é—´é€šä¿¡ã€å…¨å±€çŠ¶æ€ç»´æŠ¤  
- **èµ„æºè®¿é—®**ï¼šé…ç½®æ–‡ä»¶ã€æ¨¡æ¿æ–‡ä»¶çš„ç»Ÿä¸€åŠ è½½
- **ç»Ÿè®¡ç›‘æ§**ï¼šè®¿é—®è®¡æ•°ã€ç³»ç»Ÿç›‘æ§æ•°æ®æ”¶é›†
- **ç¼“å­˜ç³»ç»Ÿ**ï¼šå…¨å±€æ•°æ®ç¼“å­˜ï¼Œæé«˜æ€§èƒ½

**ğŸ”§ å¼€å‘å®è·µå»ºè®®**
```
é…ç½®ç®¡ç†ï¼š
- æ•æ„Ÿä¿¡æ¯æ”¾åœ¨web.xmlçš„<context-param>ä¸­
- å¤æ‚é…ç½®ä½¿ç”¨propertiesæ–‡ä»¶
- é€šè¿‡ServletContextListeneråˆå§‹åŒ–é…ç½®

æ•°æ®å­˜å‚¨ï¼š
- åªå­˜å‚¨çœŸæ­£éœ€è¦å…¨å±€å…±äº«çš„æ•°æ®
- æ³¨æ„å†…å­˜ä½¿ç”¨ï¼Œé¿å…å­˜å‚¨å¤§é‡æ•°æ®
- è€ƒè™‘å¹¶å‘å®‰å…¨ï¼Œä½¿ç”¨é€‚å½“çš„åŒæ­¥æœºåˆ¶

èµ„æºè®¿é—®ï¼š
- ç»Ÿä¸€ä½¿ç”¨ç»å¯¹è·¯å¾„
- åˆç†ä½¿ç”¨ç¼“å­˜æœºåˆ¶
- å¤„ç†æ–‡ä»¶ä¸å­˜åœ¨çš„å¼‚å¸¸æƒ…å†µ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- ServletContextæ˜¯Webåº”ç”¨çš„å…¨å±€ç®¡ç†è€…ï¼Œå•ä¾‹æ¨¡å¼ç¡®ä¿å”¯ä¸€æ€§
- é€šè¿‡å…¨å±€å‚æ•°ã€å±æ€§å­˜å‚¨ã€èµ„æºè®¿é—®ä¸‰å¤§åŠŸèƒ½æœåŠ¡æ•´ä¸ªåº”ç”¨
- åˆç†ä½¿ç”¨å¯ä»¥æé«˜å¼€å‘æ•ˆç‡ï¼Œä½†è¦æ³¨æ„çº¿ç¨‹å®‰å…¨å’Œå†…å­˜ç®¡ç†
- ç”Ÿå‘½å‘¨æœŸä¸Webåº”ç”¨ä¸€è‡´ï¼Œä»å¯åŠ¨åˆ°å…³é—­å§‹ç»ˆå­˜åœ¨