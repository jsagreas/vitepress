---
title: 2ã€å“åº”å†…å®¹è¾“å‡º
---
## ğŸ“š ç›®å½•

1. [å“åº”è¾“å‡ºæµæ¦‚è¿°](#1-å“åº”è¾“å‡ºæµæ¦‚è¿°)
2. [å­—ç¬¦æµPrintWriterè¯¦è§£](#2-å­—ç¬¦æµPrintWriterè¯¦è§£)
3. [å­—èŠ‚æµServletOutputStreamè¯¦è§£](#3-å­—èŠ‚æµServletOutputStreamè¯¦è§£)
4. [HTMLå†…å®¹è¾“å‡ºå®æˆ˜](#4-HTMLå†…å®¹è¾“å‡ºå®æˆ˜)
5. [JSONæ•°æ®è¾“å‡ºå®æˆ˜](#5-JSONæ•°æ®è¾“å‡ºå®æˆ˜)
6. [æ–‡ä»¶ä¸‹è½½åŠŸèƒ½å®ç°](#6-æ–‡ä»¶ä¸‹è½½åŠŸèƒ½å®ç°)
7. [å›¾ç‰‡éªŒè¯ç ç”Ÿæˆ](#7-å›¾ç‰‡éªŒè¯ç ç”Ÿæˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¡ å“åº”è¾“å‡ºæµæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å“åº”è¾“å‡ºæµ


**ğŸ¯ é€šä¿—ç†è§£**
æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼Œå¨å¸ˆåšå¥½èœåéœ€è¦æŠŠèœç«¯ç»™ä½ ã€‚åœ¨Webå¼€å‘ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼š
- **æµè§ˆå™¨** = é¡¾å®¢ï¼ˆå‘é€è¯·æ±‚ï¼‰
- **Servlet** = å¨å¸ˆï¼ˆå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼‰
- **å“åº”è¾“å‡ºæµ** = æœåŠ¡å‘˜ï¼ˆæŠŠç»“æœé€ç»™æµè§ˆå™¨ï¼‰

```
æµè§ˆå™¨è¯·æ±‚ â†’ Servletå¤„ç† â†’ é€šè¿‡è¾“å‡ºæµ â†’ è¿”å›ç»™æµè§ˆå™¨
   â†“            â†“           â†“            â†“
  ç‚¹èœ        â†’ åšèœ     â†’ æœåŠ¡å‘˜ç«¯èœ  â†’ é¡¾å®¢æ”¶åˆ°
```

### 1.2 ä¸¤ç§è¾“å‡ºæµçš„åŒºåˆ«


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”**
```
å­—ç¬¦æµ PrintWriterï¼š
â€¢ ä¸“é—¨å¤„ç†æ–‡å­—å†…å®¹ï¼ˆHTMLã€JSONã€XMLç­‰ï¼‰
â€¢ è‡ªåŠ¨å¤„ç†å­—ç¬¦ç¼–ç è½¬æ¢
â€¢ ç±»ä¼¼ç”¨"æ–‡å­—ç¬”"å†™å­—

å­—èŠ‚æµ ServletOutputStreamï¼š
â€¢ å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼ˆå›¾ç‰‡ã€æ–‡ä»¶ã€éªŒè¯ç ç­‰ï¼‰
â€¢ ä¼ è¾“åŸå§‹çš„0å’Œ1æ•°æ®
â€¢ ç±»ä¼¼ç”¨"å°ç« "ç›–å°
```

**ğŸ“Š ä½¿ç”¨åœºæ™¯å¯¹æ¯”è¡¨**

| **è¾“å‡ºæµç±»å‹** | **é€‚ç”¨å†…å®¹** | **å…¸å‹åœºæ™¯** | **è·å–æ–¹æ³•** |
|---------------|-------------|-------------|-------------|
| ğŸ–Šï¸ **PrintWriter** | `æ–‡æœ¬æ•°æ®` | `HTMLé¡µé¢ã€JSONæ•°æ®ã€æ™®é€šæ–‡å­—` | `response.getWriter()` |
| ğŸ“¦ **ServletOutputStream** | `äºŒè¿›åˆ¶æ•°æ®` | `å›¾ç‰‡ã€æ–‡ä»¶ä¸‹è½½ã€éªŒè¯ç ` | `response.getOutputStream()` |

### 1.3 é‡è¦æ³¨æ„äº‹é¡¹


> âš ï¸ **å…³é”®é™åˆ¶**: åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œ**åªèƒ½é€‰æ‹©å…¶ä¸­ä¸€ç§è¾“å‡ºæµ**ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼

**ğŸš« é”™è¯¯åšæ³•**
```java
// è¿™æ ·ä¼šæŠ¥é”™ï¼
PrintWriter writer = response.getWriter();
ServletOutputStream out = response.getOutputStream(); // å¼‚å¸¸ï¼
```

**âœ… æ­£ç¡®åšæ³•**
```java
// æ ¹æ®éœ€è¦é€‰æ‹©ä¸€ç§
if (éœ€è¦è¾“å‡ºæ–‡æœ¬) {
    PrintWriter writer = response.getWriter();
} else {
    ServletOutputStream out = response.getOutputStream();
}
```

---

## 2. âœï¸ å­—ç¬¦æµPrintWriterè¯¦è§£


### 2.1 PrintWriteråŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯PrintWriter**
PrintWriterå°±åƒä¸€æ”¯"æ™ºèƒ½ç¬”"ï¼Œä¸“é—¨ç”¨æ¥å¾€æµè§ˆå™¨"å†™å­—"ï¼š
- **è‡ªåŠ¨å¤„ç†ç¼–ç **ï¼šä½ å†™ä¸­æ–‡ï¼Œå®ƒè‡ªåŠ¨è½¬æˆæµè§ˆå™¨èƒ½è¯†åˆ«çš„ç¼–ç 
- **ç¼“å†²æœºåˆ¶**ï¼šå…ˆæŠŠå†…å®¹å­˜åœ¨"è‰ç¨¿çº¸"ä¸Šï¼Œä¸€æ¬¡æ€§å‘é€
- **è‡ªåŠ¨æ¢è¡Œ**ï¼šæä¾›println()æ–¹æ³•è‡ªåŠ¨æ¢è¡Œ

### 2.2 è·å–å’Œä½¿ç”¨PrintWriter


**ğŸ“ åŸºæœ¬ä½¿ç”¨æ­¥éª¤**
```java
@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // æ­¥éª¤1ï¼šè®¾ç½®å“åº”å†…å®¹ç±»å‹ï¼ˆå¾ˆé‡è¦ï¼ï¼‰
        response.setContentType("text/html;charset=UTF-8");
        
        // æ­¥éª¤2ï¼šè·å–å­—ç¬¦è¾“å‡ºæµ
        PrintWriter writer = response.getWriter();
        
        // æ­¥éª¤3ï¼šå†™å…¥å†…å®¹
        writer.println("<h1>æ¬¢è¿æ¥åˆ°æˆ‘çš„ç½‘ç«™ï¼</h1>");
        writer.println("<p>å½“å‰æ—¶é—´ï¼š" + new Date() + "</p>");
        
        // æ­¥éª¤4ï¼šå…³é—­æµï¼ˆå¯é€‰ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å…³é—­ï¼‰
        writer.close();
    }
}
```

### 2.3 PrintWriterå¸¸ç”¨æ–¹æ³•


**ğŸ› ï¸ æ ¸å¿ƒæ–¹æ³•è¯´æ˜**

| **æ–¹æ³•** | **ä½œç”¨** | **ç¤ºä¾‹** |
|---------|---------|---------|
| `print(å†…å®¹)` | `è¾“å‡ºå†…å®¹ï¼Œä¸æ¢è¡Œ` | `writer.print("Hello")` |
| `println(å†…å®¹)` | `è¾“å‡ºå†…å®¹å¹¶æ¢è¡Œ` | `writer.println("Hello")` |
| `write(å†…å®¹)` | `å†™å…¥å­—ç¬¦æ•°æ®` | `writer.write("Hello")` |
| `flush()` | `å¼ºåˆ¶å‘é€ç¼“å†²åŒºå†…å®¹` | `writer.flush()` |

**ğŸ’¡ å®ç”¨ç¤ºä¾‹**
```java
PrintWriter writer = response.getWriter();

// è¾“å‡ºä¸æ¢è¡Œ
writer.print("å§“åï¼š");
writer.print("å¼ ä¸‰"); // ç»“æœï¼šå§“åï¼šå¼ ä¸‰

// è¾“å‡ºå¹¶æ¢è¡Œ  
writer.println("ç¬¬ä¸€è¡Œ");
writer.println("ç¬¬äºŒè¡Œ");
// ç»“æœï¼š
// ç¬¬ä¸€è¡Œ
// ç¬¬äºŒè¡Œ

// æ ¼å¼åŒ–è¾“å‡º
writer.printf("ç”¨æˆ·IDï¼š%dï¼Œå§“åï¼š%s", 1001, "æå››");
```

---

## 3. ğŸ“¦ å­—èŠ‚æµServletOutputStreamè¯¦è§£


### 3.1 ServletOutputStreamåŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ServletOutputStream**
ServletOutputStreamåƒä¸€ä¸ª"ä¼ è¾“ç®¡é“"ï¼Œä¸“é—¨ä¼ é€äºŒè¿›åˆ¶æ•°æ®ï¼š
- **åŸå§‹æ•°æ®ä¼ è¾“**ï¼šä¼ è¾“å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰æ–‡ä»¶çš„åŸå§‹å­—èŠ‚
- **ç²¾ç¡®æ§åˆ¶**ï¼šæ¯ä¸€ä¸ªå­—èŠ‚éƒ½æŒ‰åŸæ ·ä¼ è¾“ï¼Œä¸åšä»»ä½•è½¬æ¢
- **é«˜æ•ˆä¼ è¾“**ï¼šç›´æ¥æ“ä½œå­—èŠ‚ï¼Œä¼ è¾“æ•ˆç‡æ›´é«˜

### 3.2 è·å–å’Œä½¿ç”¨ServletOutputStream


**ğŸ“ åŸºæœ¬ä½¿ç”¨æ¨¡å¼**
```java
@WebServlet("/download")
public class DownloadServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // æ­¥éª¤1ï¼šè®¾ç½®å“åº”ç±»å‹ä¸ºäºŒè¿›åˆ¶æµ
        response.setContentType("application/octet-stream");
        
        // æ­¥éª¤2ï¼šè·å–å­—èŠ‚è¾“å‡ºæµ
        ServletOutputStream out = response.getOutputStream();
        
        // æ­¥éª¤3ï¼šå†™å…¥å­—èŠ‚æ•°æ®
        String data = "è¿™æ˜¯è¦ä¸‹è½½çš„å†…å®¹";
        byte[] bytes = data.getBytes("UTF-8");
        out.write(bytes);
        
        // æ­¥éª¤4ï¼šå…³é—­æµ
        out.close();
    }
}
```

### 3.3 ServletOutputStreamå¸¸ç”¨æ–¹æ³•


**ğŸ› ï¸ æ ¸å¿ƒæ–¹æ³•å¯¹æ¯”**

| **æ–¹æ³•** | **å‚æ•°ç±»å‹** | **ä½œç”¨** | **ä½¿ç”¨åœºæ™¯** |
|---------|-------------|---------|-------------|
| `write(int b)` | `å•ä¸ªå­—èŠ‚` | `å†™å…¥ä¸€ä¸ªå­—èŠ‚` | `é€å­—èŠ‚æ§åˆ¶` |
| `write(byte[] b)` | `å­—èŠ‚æ•°ç»„` | `å†™å…¥æ•´ä¸ªæ•°ç»„` | `æ‰¹é‡ä¼ è¾“` |
| `write(byte[] b, int off, int len)` | `æ•°ç»„ç‰‡æ®µ` | `å†™å…¥æ•°ç»„çš„ä¸€éƒ¨åˆ†` | `ç²¾ç¡®æ§åˆ¶èŒƒå›´` |

---

## 4. ğŸŒ HTMLå†…å®¹è¾“å‡ºå®æˆ˜


### 4.1 åŸºç¡€HTMLé¡µé¢è¾“å‡º


**ğŸ¯ å®æˆ˜ç›®æ ‡**ï¼šåˆ›å»ºä¸€ä¸ªæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯çš„HTMLé¡µé¢

```java
@WebServlet("/userInfo")
public class UserInfoServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // è®¾ç½®å“åº”ç±»å‹å’Œç¼–ç 
        response.setContentType("text/html;charset=UTF-8");
        
        PrintWriter writer = response.getWriter();
        
        // æ„å»ºHTMLé¡µé¢
        writer.println("<!DOCTYPE html>");
        writer.println("<html>");
        writer.println("<head>");
        writer.println("    <title>ç”¨æˆ·ä¿¡æ¯</title>");
        writer.println("    <style>");
        writer.println("        body { font-family: Arial; margin: 40px; }");
        writer.println("        .user-card { border: 1px solid #ccc; padding: 20px; }");
        writer.println("    </style>");
        writer.println("</head>");
        writer.println("<body>");
        writer.println("    <div class='user-card'>");
        writer.println("        <h2>ç”¨æˆ·æ¡£æ¡ˆ</h2>");
        writer.println("        <p><strong>å§“åï¼š</strong>å¼ ä¸‰</p>");
        writer.println("        <p><strong>å¹´é¾„ï¼š</strong>25å²</p>");
        writer.println("        <p><strong>é‚®ç®±ï¼š</strong>zhangsan@email.com</p>");
        writer.println("    </div>");
        writer.println("</body>");
        writer.println("</html>");
    }
}
```

### 4.2 åŠ¨æ€HTMLå†…å®¹ç”Ÿæˆ


**ğŸ’¡ å®æˆ˜æŠ€å·§**ï¼šæ ¹æ®å‚æ•°ç”Ÿæˆä¸åŒå†…å®¹

```java
@WebServlet("/welcome")
public class WelcomeServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter writer = response.getWriter();
        
        // è·å–å‚æ•°
        String userName = request.getParameter("name");
        String userType = request.getParameter("type");
        
        // æ ¹æ®ç”¨æˆ·ç±»å‹æ˜¾ç¤ºä¸åŒæ¬¢è¿ä¿¡æ¯
        String welcomeMsg;
        String bgColor;
        
        if ("admin".equals(userType)) {
            welcomeMsg = "ç®¡ç†å‘˜ï¼Œæ‚¨å¥½ï¼";
            bgColor = "#ff6b6b";
        } else if ("vip".equals(userType)) {
            welcomeMsg = "å°Šè´µçš„VIPç”¨æˆ·ï¼Œæ¬¢è¿å›æ¥ï¼";
            bgColor = "#ffd93d";
        } else {
            welcomeMsg = "æ™®é€šç”¨æˆ·ï¼Œæ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„æœåŠ¡ï¼";
            bgColor = "#6bcf7f";
        }
        
        // è¾“å‡ºåŠ¨æ€HTML
        writer.println("<!DOCTYPE html>");
        writer.println("<html><head><title>æ¬¢è¿é¡µé¢</title></head>");
        writer.printf("<body style='background-color: %s; padding: 50px;'>%n", bgColor);
        writer.printf("    <h1>æ¬¢è¿ %s</h1>%n", userName != null ? userName : "åŒ¿åç”¨æˆ·");
        writer.printf("    <p>%s</p>%n", welcomeMsg);
        writer.println("    <a href='index.html'>è¿”å›é¦–é¡µ</a>");
        writer.println("</body></html>");
    }
}
```

---

## 5. ğŸ“Š JSONæ•°æ®è¾“å‡ºå®æˆ˜


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦JSONè¾“å‡º


**ğŸ¤” åº”ç”¨åœºæ™¯ç†è§£**
ç°ä»£Webå¼€å‘ä¸­ï¼Œå‰ç«¯ï¼ˆå¦‚Vueã€Reactï¼‰å’Œåç«¯åˆ†ç¦»ï¼š
- **å‰ç«¯**ï¼šè´Ÿè´£é¡µé¢å±•ç¤ºå’Œç”¨æˆ·äº¤äº’
- **åç«¯**ï¼šè´Ÿè´£æ•°æ®å¤„ç†å’Œä¸šåŠ¡é€»è¾‘
- **JSON**ï¼šä½œä¸ºä¸¤è€…ä¹‹é—´çš„"é€šç”¨è¯­è¨€"

```
å‰ç«¯JavaScript    â†â†’    JSONæ•°æ®    â†â†’    åç«¯Servlet
     â†“                      â†“                â†“
   ç”¨æˆ·ç•Œé¢              æ ‡å‡†æ ¼å¼           ä¸šåŠ¡é€»è¾‘
```

### 5.2 ç®€å•JSONæ•°æ®è¾“å‡º


**ğŸ“ åŸºç¡€JSONè¾“å‡ºç¤ºä¾‹**
```java
@WebServlet("/api/user")
public class UserApiServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // è®¾ç½®JSONå“åº”ç±»å‹
        response.setContentType("application/json;charset=UTF-8");
        
        PrintWriter writer = response.getWriter();
        
        // æ‰‹åŠ¨æ„å»ºJSONå­—ç¬¦ä¸²
        String jsonData = "{"
            + "\"id\": 1001,"
            + "\"name\": \"å¼ ä¸‰\","
            + "\"age\": 25,"
            + "\"email\": \"zhangsan@email.com\","
            + "\"isVip\": true"
            + "}";
        
        writer.print(jsonData);
    }
}
```

### 5.3 å¤æ‚JSONæ•°æ®è¾“å‡º


**ğŸ¯ å®æˆ˜æ¡ˆä¾‹**ï¼šè¿”å›ç”¨æˆ·åˆ—è¡¨æ•°æ®

```java
@WebServlet("/api/users")
public class UsersApiServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        response.setContentType("application/json;charset=UTF-8");
        PrintWriter writer = response.getWriter();
        
        // æ¨¡æ‹Ÿä»æ•°æ®åº“è·å–ç”¨æˆ·åˆ—è¡¨
        List<String> users = Arrays.asList("å¼ ä¸‰", "æå››", "ç‹äº”");
        
        // æ„å»ºJSONå“åº”
        writer.println("{");
        writer.println("  \"code\": 200,");
        writer.println("  \"message\": \"æŸ¥è¯¢æˆåŠŸ\",");
        writer.println("  \"data\": [");
        
        for (int i = 0; i < users.size(); i++) {
            writer.printf("    {\"id\": %d, \"name\": \"%s\"}", 
                         i + 1, users.get(i));
            if (i < users.size() - 1) {
                writer.println(","); // ä¸æ˜¯æœ€åä¸€ä¸ªï¼Œæ·»åŠ é€—å·
            } else {
                writer.println();   // æœ€åä¸€ä¸ªï¼Œä¸åŠ é€—å·
            }
        }
        
        writer.println("  ]");
        writer.println("}");
    }
}
```

> ğŸ’¡ **å®ç”¨å»ºè®®**ï¼šå®é™…é¡¹ç›®ä¸­å»ºè®®ä½¿ç”¨Jacksonæˆ–Gsonç­‰JSONåº“ï¼Œé¿å…æ‰‹åŠ¨æ‹¼æ¥JSONå­—ç¬¦ä¸²

---

## 6. ğŸ“¥ æ–‡ä»¶ä¸‹è½½åŠŸèƒ½å®ç°


### 6.1 æ–‡ä»¶ä¸‹è½½åŸç†


**ğŸ” ä¸‹è½½æœºåˆ¶ç†è§£**
å½“ç”¨æˆ·ç‚¹å‡»ä¸‹è½½é“¾æ¥æ—¶ï¼Œæµè§ˆå™¨éœ€è¦çŸ¥é“ï¼š
1. **è¿™æ˜¯è¦ä¸‹è½½çš„æ–‡ä»¶**ï¼ˆé€šè¿‡Content-Typeå‘ŠçŸ¥ï¼‰
2. **æ–‡ä»¶å«ä»€ä¹ˆåå­—**ï¼ˆé€šè¿‡Content-Dispositionå‘ŠçŸ¥ï¼‰
3. **æ–‡ä»¶æœ‰å¤šå¤§**ï¼ˆé€šè¿‡Content-Lengthå‘ŠçŸ¥ï¼Œå¯é€‰ï¼‰

```
ç”¨æˆ·ç‚¹å‡»ä¸‹è½½ â†’ æµè§ˆå™¨å‘é€è¯·æ±‚ â†’ Servletè®¾ç½®å“åº”å¤´ â†’ ä¼ è¾“æ–‡ä»¶å­—èŠ‚ â†’ æµè§ˆå™¨ä¿å­˜æ–‡ä»¶
```

### 6.2 æ–‡æœ¬æ–‡ä»¶ä¸‹è½½å®ç°


**ğŸ“ å®æˆ˜ä»£ç **
```java
@WebServlet("/download/text")
public class TextDownloadServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // è¦ä¸‹è½½çš„æ–‡æœ¬å†…å®¹
        String content = "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶\nåŒ…å«ä¸­æ–‡å†…å®¹\nä¸‹è½½æ—¶é—´ï¼š" + new Date();
        byte[] bytes = content.getBytes("UTF-8");
        
        // è®¾ç½®å“åº”å¤´ä¿¡æ¯
        response.setContentType("application/octet-stream");
        response.setHeader("Content-Disposition", "attachment; filename=test.txt");
        response.setContentLength(bytes.length);
        
        // è·å–å­—èŠ‚è¾“å‡ºæµå¹¶å†™å…¥æ•°æ®
        ServletOutputStream out = response.getOutputStream();
        out.write(bytes);
        out.close();
    }
}
```

### 6.3 å›¾ç‰‡æ–‡ä»¶ä¸‹è½½å®ç°


**ğŸ–¼ï¸ å®é™…æ–‡ä»¶ä¸‹è½½ç¤ºä¾‹**
```java
@WebServlet("/download/image")
public class ImageDownloadServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // å‡è®¾å›¾ç‰‡æ–‡ä»¶åœ¨webapp/images/ç›®å½•ä¸‹
        String fileName = "sample.jpg";
        String filePath = getServletContext().getRealPath("/images/" + fileName);
        
        File file = new File(filePath);
        if (!file.exists()) {
            response.sendError(404, "æ–‡ä»¶ä¸å­˜åœ¨");
            return;
        }
        
        // è®¾ç½®ä¸‹è½½å“åº”å¤´
        response.setContentType("application/octet-stream");
        response.setHeader("Content-Disposition", 
                          "attachment; filename=" + fileName);
        response.setContentLength((int) file.length());
        
        // è¯»å–æ–‡ä»¶å¹¶è¾“å‡º
        try (FileInputStream fis = new FileInputStream(file);
             ServletOutputStream out = response.getOutputStream()) {
            
            byte[] buffer = new byte[4096]; // 4KBç¼“å†²åŒº
            int bytesRead;
            
            while ((bytesRead = fis.read(buffer)) != -1) {
                out.write(buffer, 0, bytesRead);
            }
        }
    }
}
```

### 6.4 ä¸­æ–‡æ–‡ä»¶åå¤„ç†


> âš ï¸ **é‡è¦æé†’**ï¼šå¦‚æœæ–‡ä»¶ååŒ…å«ä¸­æ–‡ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¦åˆ™ä¸‹è½½æ—¶æ–‡ä»¶åä¼šä¹±ç 

```java
// å¤„ç†ä¸­æ–‡æ–‡ä»¶åçš„æ–¹æ³•
private String getEncodedFileName(String fileName) throws UnsupportedEncodingException {
    return URLEncoder.encode(fileName, "UTF-8").replaceAll("\\+", "%20");
}

// åœ¨è®¾ç½®å“åº”å¤´æ—¶ä½¿ç”¨
String chineseFileName = "æˆ‘çš„æ–‡æ¡£.pdf";
String encodedName = getEncodedFileName(chineseFileName);
response.setHeader("Content-Disposition", 
                  "attachment; filename*=UTF-8''" + encodedName);
```

---

## 7. ğŸ¨ å›¾ç‰‡éªŒè¯ç ç”Ÿæˆ


### 7.1 éªŒè¯ç çš„ä½œç”¨


**ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤ç†è§£**
éªŒè¯ç å°±åƒé—¨å«ï¼Œé˜²æ­¢æ¶æ„ç¨‹åºè‡ªåŠ¨æ“ä½œï¼š
- **é˜²æ­¢æœºå™¨äººæ³¨å†Œ**ï¼šé¿å…æ‰¹é‡æ³¨å†Œå‡è´¦å·
- **é˜²æ­¢æš´åŠ›ç ´è§£**ï¼šé¿å…è‡ªåŠ¨å°è¯•å¯†ç 
- **é˜²æ­¢æ¶æ„æäº¤**ï¼šé¿å…åƒåœ¾ä¿¡æ¯è‡ªåŠ¨å‘é€

### 7.2 ç®€å•æ•°å­—éªŒè¯ç å®ç°


**ğŸ”¢ åŸºç¡€éªŒè¯ç ç”Ÿæˆ**
```java
@WebServlet("/captcha")
public class CaptchaServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response) throws IOException {
        
        // åˆ›å»ºå›¾ç‰‡ï¼šå®½100ï¼Œé«˜30åƒç´ 
        int width = 100;
        int height = 30;
        BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
        
        // è·å–ç”»ç¬”
        Graphics2D g = image.createGraphics();
        
        // è®¾ç½®èƒŒæ™¯è‰²ï¼ˆç™½è‰²ï¼‰
        g.setColor(Color.WHITE);
        g.fillRect(0, 0, width, height);
        
        // ç”ŸæˆéšæœºéªŒè¯ç ï¼ˆ4ä½æ•°å­—ï¼‰
        Random random = new Random();
        StringBuilder code = new StringBuilder();
        
        // è®¾ç½®å­—ä½“å’Œé¢œè‰²
        g.setFont(new Font("Arial", Font.BOLD, 20));
        g.setColor(Color.BLACK);
        
        // ç”»4ä¸ªéšæœºæ•°å­—
        for (int i = 0; i < 4; i++) {
            int digit = random.nextInt(10); // 0-9éšæœºæ•°å­—
            code.append(digit);
            g.drawString(String.valueOf(digit), 20 + i * 15, 20);
        }
        
        // å°†éªŒè¯ç å­˜å…¥Sessionï¼ˆä¾›åç»­éªŒè¯ä½¿ç”¨ï¼‰
        request.getSession().setAttribute("captcha", code.toString());
        
        // æ·»åŠ å¹²æ‰°çº¿
        g.setColor(Color.GRAY);
        for (int i = 0; i < 5; i++) {
            int x1 = random.nextInt(width);
            int y1 = random.nextInt(height);
            int x2 = random.nextInt(width);
            int y2 = random.nextInt(height);
            g.drawLine(x1, y1, x2, y2);
        }
        
        g.dispose(); // é‡Šæ”¾ç”»ç¬”èµ„æº
        
        // è®¾ç½®å“åº”ç±»å‹ä¸ºå›¾ç‰‡
        response.setContentType("image/jpeg");
        
        // è¾“å‡ºå›¾ç‰‡åˆ°æµè§ˆå™¨
        ServletOutputStream out = response.getOutputStream();
        ImageIO.write(image, "JPEG", out);
        out.close();
    }
}
```

### 7.3 éªŒè¯ç éªŒè¯å®ç°


**âœ… éªŒè¯ç æ ¡éªŒç¤ºä¾‹**
```java
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, 
                         HttpServletResponse response) throws IOException {
        
        // è·å–ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç 
        String userCaptcha = request.getParameter("captcha");
        
        // è·å–Sessionä¸­å­˜å‚¨çš„æ­£ç¡®éªŒè¯ç 
        String sessionCaptcha = (String) request.getSession().getAttribute("captcha");
        
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter writer = response.getWriter();
        
        // éªŒè¯ç æ ¡éªŒ
        if (sessionCaptcha != null && sessionCaptcha.equals(userCaptcha)) {
            writer.println("<h2 style='color: green;'>éªŒè¯ç æ­£ç¡®ï¼</h2>");
            // éªŒè¯é€šè¿‡åæ¸…é™¤Sessionä¸­çš„éªŒè¯ç 
            request.getSession().removeAttribute("captcha");
        } else {
            writer.println("<h2 style='color: red;'>éªŒè¯ç é”™è¯¯ï¼</h2>");
        }
        
        writer.println("<a href='login.html'>é‡æ–°ç™»å½•</a>");
    }
}
```

### 7.4 å‰ç«¯é¡µé¢é…åˆä½¿ç”¨


**ğŸŒ HTMLé¡µé¢ç¤ºä¾‹**
```html
<!DOCTYPE html>
<html>
<head>
    <title>ç™»å½•é¡µé¢</title>
</head>
<body>
    <form action="login" method="post">
        <div>
            <label>ç”¨æˆ·åï¼š</label>
            <input type="text" name="username" required>
        </div>
        <div>
            <label>å¯†ç ï¼š</label>
            <input type="password" name="password" required>
        </div>
        <div>
            <label>éªŒè¯ç ï¼š</label>
            <input type="text" name="captcha" required>
            <img src="captcha" alt="éªŒè¯ç " onclick="this.src='captcha?'+Date.now()">
            <small>ç‚¹å‡»å›¾ç‰‡åˆ·æ–°éªŒè¯ç </small>
        </div>
        <button type="submit">ç™»å½•</button>
    </form>
</body>
</html>
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ è¾“å‡ºæµé€‰æ‹©ï¼šå­—ç¬¦æµå¤„ç†æ–‡æœ¬ï¼Œå­—èŠ‚æµå¤„ç†äºŒè¿›åˆ¶
ğŸ”¸ æµçš„äº’æ–¥æ€§ï¼šåŒä¸€è¯·æ±‚åªèƒ½ä½¿ç”¨ä¸€ç§è¾“å‡ºæµ
ğŸ”¸ å“åº”ç±»å‹è®¾ç½®ï¼šContentTypeå†³å®šæµè§ˆå™¨å¦‚ä½•å¤„ç†å“åº”
ğŸ”¸ å­—ç¬¦ç¼–ç å¤„ç†ï¼šUTF-8è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
ğŸ”¸ ç¼“å†²åŒºæœºåˆ¶ï¼šç†è§£flush()çš„ä½œç”¨å’Œæ—¶æœº
```

### 8.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ PrintWriteræ ¸å¿ƒç‰¹ç‚¹**
- âœ… **è‡ªåŠ¨ç¼–ç è½¬æ¢**ï¼šå¤„ç†ä¸­æ–‡ç­‰å¤šå­—èŠ‚å­—ç¬¦
- âœ… **ä¾¿æ·æ–¹æ³•**ï¼šprint()ã€println()ã€printf()
- âœ… **ç¼“å†²è¾“å‡º**ï¼šæé«˜è¾“å‡ºæ•ˆç‡
- âŒ **ä»…é™æ–‡æœ¬**ï¼šä¸èƒ½å¤„ç†äºŒè¿›åˆ¶æ•°æ®

**ğŸ”¹ ServletOutputStreamæ ¸å¿ƒç‰¹ç‚¹**
- âœ… **äºŒè¿›åˆ¶ä¼ è¾“**ï¼šåŸå§‹å­—èŠ‚æ•°æ®ä¼ è¾“
- âœ… **é«˜æ•ˆå¤„ç†**ï¼šç›´æ¥æ“ä½œå­—èŠ‚æ•°ç»„
- âœ… **æ–‡ä»¶ä¸‹è½½**ï¼šå¤„ç†å„ç§æ–‡ä»¶ç±»å‹
- âŒ **ç¼–ç å¤æ‚**ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†å­—ç¬¦ç¼–ç 

**ğŸ”¹ å®é™…åº”ç”¨æŒ‡å¯¼**
```
HTMLé¡µé¢è¾“å‡º â†’ ä½¿ç”¨PrintWriter
JSON APIå“åº” â†’ ä½¿ç”¨PrintWriter  
æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ â†’ ä½¿ç”¨ServletOutputStream
å›¾ç‰‡éªŒè¯ç  â†’ ä½¿ç”¨ServletOutputStream
åŠ¨æ€å›¾è¡¨ç”Ÿæˆ â†’ ä½¿ç”¨ServletOutputStream
```

### 8.3 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**â“ é—®é¢˜1ï¼šä¸­æ–‡ä¹±ç æ€ä¹ˆåŠï¼Ÿ**
```java
// è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®æ­£ç¡®çš„ç¼–ç 
response.setContentType("text/html;charset=UTF-8");
```

**â“ é—®é¢˜2ï¼šä¸‹è½½çš„æ–‡ä»¶åæ˜¯ä¹±ç ï¼Ÿ**
```java
// è§£å†³æ–¹æ¡ˆï¼šå¯¹ä¸­æ–‡æ–‡ä»¶åè¿›è¡ŒURLç¼–ç 
String encodedName = URLEncoder.encode("ä¸­æ–‡æ–‡ä»¶å.pdf", "UTF-8");
response.setHeader("Content-Disposition", "attachment; filename*=UTF-8''" + encodedName);
```

**â“ é—®é¢˜3ï¼šéªŒè¯ç ä¸æ˜¾ç¤ºï¼Ÿ**
```java
// æ£€æŸ¥ç‚¹ï¼š
// 1. å“åº”ç±»å‹æ˜¯å¦è®¾ç½®ä¸ºimage/jpeg
// 2. æ˜¯å¦æ­£ç¡®ä½¿ç”¨ServletOutputStream
// 3. æ˜¯å¦è°ƒç”¨äº†ImageIO.write()
```

**â“ é—®é¢˜4ï¼šJSONæ•°æ®æ ¼å¼é”™è¯¯ï¼Ÿ**
```java
// é¿å…æ‰‹åŠ¨æ‹¼æ¥ï¼Œä½¿ç”¨æ ‡å‡†æ ¼å¼ï¼š
{
    "code": 200,
    "message": "success",
    "data": {...}
}
```

### 8.4 æœ€ä½³å®è·µå»ºè®®


**ğŸŒŸ å¼€å‘å»ºè®®**
- ğŸ“ **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼šAPIæ¥å£ä½¿ç”¨ç»Ÿä¸€çš„JSONæ ¼å¼
- ğŸ”’ **å®‰å…¨è€ƒè™‘**ï¼šæ–‡ä»¶ä¸‹è½½æ—¶éªŒè¯ç”¨æˆ·æƒé™
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§æ–‡ä»¶ä¸‹è½½ä½¿ç”¨ç¼“å†²åŒºåˆ†å—ä¼ è¾“
- ğŸ¨ **ç”¨æˆ·ä½“éªŒ**ï¼šéªŒè¯ç æ·»åŠ åˆ·æ–°åŠŸèƒ½
- ğŸ“± **ç§»åŠ¨é€‚é…**ï¼šéªŒè¯ç å›¾ç‰‡å¤§å°é€‚é…ç§»åŠ¨ç«¯

**ğŸ’¡ è®°å¿†æŠ€å·§**
- **å­—ç¬¦æµ**ï¼šå¤„ç†"çœ‹å¾—æ‡‚"çš„å†…å®¹ï¼ˆHTMLã€JSONã€æ–‡å­—ï¼‰
- **å­—èŠ‚æµ**ï¼šå¤„ç†"çœ‹ä¸æ‡‚"çš„å†…å®¹ï¼ˆå›¾ç‰‡ã€æ–‡ä»¶ã€éªŒè¯ç ï¼‰
- **ä¸‹è½½ä¸‰è¦ç´ **ï¼šç±»å‹(ContentType) + æ–‡ä»¶å(Content-Disposition) + å¤§å°(Content-Length)
- **éªŒè¯ç æµç¨‹**ï¼šç”Ÿæˆâ†’å­˜Sessionâ†’æ˜¾ç¤ºâ†’ç”¨æˆ·è¾“å…¥â†’éªŒè¯â†’æ¸…é™¤

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å­—ç¬¦æ–‡æœ¬ç”¨Writerï¼ŒäºŒè¿›åˆ¶ç”¨Stream
- å“åº”ç±»å‹è¦è®¾å¯¹ï¼Œç¼–ç UTF-8ä¸ä¼šé”™  
- æ–‡ä»¶ä¸‹è½½è®¾ä¸‰å¤´ï¼ŒéªŒè¯ç è¦å­˜Session
- ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªæµï¼Œåƒä¸‡ä¸è¦åŒæ—¶ç”¨