---
title: 2、异常错误码对照
---
## 📚 目录

1. [JDBC异常概述](#1-JDBC异常概述)
2. [常见SQLState错误分类](#2-常见SQLState错误分类)
3. [MySQL错误码详解](#3-MySQL错误码详解)
4. [Oracle错误码详解](#4-Oracle错误码详解)
5. [网络连接异常](#5-网络连接异常)
6. [异常排查实用技巧](#6-异常排查实用技巧)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔍 JDBC异常概述


### 1.1 什么是JDBC异常


**简单理解**：当我们用Java程序操作数据库时，各种问题都会以"异常"的形式报告给我们。

> 💡 **生活类比**：就像你打电话时可能遇到"号码不存在"、"对方忙线"、"信号不好"等问题，数据库操作也会遇到各种状况。

**JDBC异常的本质**：
- 是Java程序与数据库"对话"时出现的问题报告
- 每个异常都有特定的**错误码**和**描述信息**
- 通过错误码可以快速定位问题原因

### 1.2 JDBC异常体系结构


```
异常层次关系：
java.lang.Exception
    └── java.sql.SQLException
            ├── SQLNonTransientException（非临时异常）
            ├── SQLTransientException（临时异常）  
            └── SQLRecoverableException（可恢复异常）
```

**三大异常类型含义**：

| 异常类型 | **含义** | **典型场景** | **处理方式** |
|---------|---------|-------------|-------------|
| `非临时异常` | 程序或配置问题，不会自动好转 | SQL语法错误、权限不足 | 需要修改代码或配置 |
| `临时异常` | 暂时性问题，可能会自动恢复 | 网络中断、数据库繁忙 | 可以重试操作 |
| `可恢复异常` | 可以通过重连等方式解决 | 连接超时、会话丢失 | 重新建立连接 |

### 1.3 错误信息的构成


```
典型JDBC异常信息组成：
java.sql.SQLException: Table 'test.users' doesn't exist
    └── 异常类型         └── 错误描述信息

SQLState: 42S02    ErrorCode: 1146
└── SQL标准错误码  └── 数据库特定错误码
```

**各部分含义**：
- **SQLState**：遵循SQL标准的5位字符错误码，所有数据库通用
- **ErrorCode**：各数据库厂商自定义的数字错误码
- **错误信息**：人类可读的问题描述

---

## 2. 📋 常见SQLState错误分类


### 2.1 SQLState编码规则


**编码格式**：`XX###` （2位类别码 + 3位子类别码）

```
SQLState分类系统：
00000 - 成功完成
01xxx - 警告信息  
02xxx - 无数据
08xxx - 连接异常
21xxx - 基数违规
22xxx - 数据异常
23xxx - 约束违规
24xxx - 游标状态无效
25xxx - 事务状态无效
28xxx - 权限异常
40xxx - 事务回滚
42xxx - 语法错误或访问规则违规
```

### 2.2 最常见的SQLState错误


#### 🔗 连接相关错误（08xxx）


| SQLState | **错误含义** | **典型场景** | **解决方案** |
|----------|-------------|-------------|-------------|
| `08001` | 无法建立连接 | 数据库服务未启动、地址错误 | 检查数据库服务和连接地址 |
| `08003` | 连接不存在 | 连接已关闭后仍尝试使用 | 重新建立连接 |
| `08004` | 连接被拒绝 | 用户名密码错误、权限不足 | 检查认证信息 |
| `08006` | 连接失败 | 网络中断、超时 | 检查网络连接 |
| `08007` | 事务处理中断 | 连接在事务中丢失 | 重连并处理事务状态 |

**实际案例**：
```java
// ❌ 常见错误：连接URL写错
String url = "jdbc:mysql://localhost:3307/test"; // 端口错误
// ✅ 正确写法
String url = "jdbc:mysql://localhost:3306/test"; // 默认端口3306
```

#### 🔒 权限相关错误（28xxx）


| SQLState | **错误含义** | **解决方案** |
|----------|-------------|-------------|
| `28000` | 权限规范违规 | 检查用户权限设置 |
| `28001` | 权限被拒绝 | 联系管理员分配权限 |

#### ⚠️ 语法和访问错误（42xxx）


| SQLState | **错误含义** | **典型SQL错误** | **解决方案** |
|----------|-------------|----------------|-------------|
| `42000` | 语法错误或访问规则违规 | `SELCT * FROM users` | 检查SQL语法 |
| `42S01` | 表或视图已存在 | `CREATE TABLE users...` | 使用IF NOT EXISTS |
| `42S02` | 表或视图不存在 | `SELECT * FROM user_info` | 检查表名拼写 |
| `42S11` | 索引已存在 | 重复创建索引 | 检查索引是否存在 |
| `42S12` | 索引不存在 | 删除不存在的索引 | 确认索引名称 |
| `42S21` | 列已存在 | `ALTER TABLE ADD COLUMN id` | 检查列是否存在 |
| `42S22` | 列不存在 | `SELECT username FROM users` | 检查列名拼写 |

#### 🚫 约束违规错误（23xxx）


| SQLState | **错误含义** | **典型场景** | **解决方案** |
|----------|-------------|-------------|-------------|
| `23000` | 约束违规 | 插入重复主键、违反唯一约束 | 检查数据唯一性 |
| `23001` | 限制违规 | 外键约束失败 | 确保参照完整性 |
| `23502` | 非空违规 | 必填字段为NULL | 提供必需的值 |
| `23503` | 外键约束违规 | 插入不存在的外键值 | 先插入被引用数据 |
| `23505` | 唯一约束违规 | 违反UNIQUE约束 | 检查重复数据 |

### 2.3 数据相关错误（22xxx）


| SQLState | **错误含义** | **解决方案** |
|----------|-------------|-------------|
| `22001` | 字符串数据右截断 | 减少字符长度或扩大字段 |
| `22003` | 数值超出范围 | 检查数值范围 |
| `22007` | 无效日期格式 | 使用正确日期格式 |
| `22012` | 除零错误 | 添加除数检查 |

---

## 3. 🐬 MySQL错误码详解


### 3.1 MySQL错误码结构


**MySQL错误码特点**：
- 使用4位数字编码（如1045、1146等）
- 每个错误码对应具体的问题描述
- 与SQLState配合使用，提供更详细信息

### 3.2 最常见MySQL错误码


#### 🔐 连接和认证错误


| 错误码 | **SQLState** | **错误信息** | **含义解释** | **解决方法** |
|-------|-------------|-------------|-------------|-------------|
| `1045` | 28000 | Access denied for user | 用户名或密码错误 | 检查用户名密码 |
| `1044` | 42000 | Access denied for user to database | 用户无权访问指定数据库 | 分配数据库权限 |
| `1040` | 08004 | Too many connections | 连接数超过限制 | 增加连接数限制或优化连接使用 |
| `2002` | 08001 | Can't connect to MySQL server | 无法连接服务器 | 检查服务状态和网络 |
| `2003` | 08001 | Can't connect to MySQL server on port | 端口连接失败 | 检查端口号和防火墙 |

**实际排查示例**：
```
错误现象：java.sql.SQLException: Access denied for user 'root'@'localhost' (using password: YES)
错误码：1045
排查步骤：
1. 确认用户名拼写：root ✓
2. 确认密码正确性：检查配置文件
3. 确认用户权限：GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost';
```

#### 📊 数据库和表错误


| 错误码 | **SQLState** | **错误场景** | **通俗解释** | **解决思路** |
|-------|-------------|-------------|-------------|-------------|
| `1146` | 42S02 | Table doesn't exist | 你要操作的表不存在 | 检查表名拼写，确认表已创建 |
| `1007` | HY000 | Database exists | 数据库已存在 | 使用IF NOT EXISTS或选择其他名称 |
| `1008` | HY000 | Can't drop database | 无法删除数据库 | 检查权限和依赖关系 |
| `1049` | 42000 | Unknown database | 数据库不存在 | 先创建数据库或检查名称 |
| `1050` | 42S01 | Table already exists | 表已存在 | 使用IF NOT EXISTS或选择其他名称 |
| `1051` | 42S02 | Unknown table | 表不存在 | 检查表名或先创建表 |

#### 🏗️ 字段和索引错误


| 错误码 | **SQLState** | **含义** | **常见原因** | **解决方案** |
|-------|-------------|---------|-------------|-------------|
| `1054` | 42S22 | Unknown column | 字段名错误或不存在 | 检查字段名拼写 |
| `1060` | 42S21 | Duplicate column name | 重复的列名 | 修改列名或检查表结构 |
| `1061` | 42000 | Duplicate key name | 重复的索引名 | 使用不同的索引名 |
| `1091` | 42000 | Can't DROP index | 无法删除索引 | 检查索引是否存在 |
| `1171` | 42000 | All parts of PRIMARY KEY must be NOT NULL | 主键不能为NULL | 设置主键字段为NOT NULL |

#### ⚠️ 数据完整性错误


| 错误码 | **SQLState** | **问题描述** | **发生场景** | **解决方法** |
|-------|-------------|-------------|-------------|-------------|
| `1062` | 23000 | Duplicate entry for key | 违反唯一约束 | 检查重复数据，修改插入值 |
| `1048` | 23000 | Column cannot be null | 必填字段为空 | 为必填字段提供值 |
| `1216` | 23000 | Cannot add or update child row | 外键约束失败 | 先插入父表数据 |
| `1217` | 23000 | Cannot delete or update parent row | 删除被引用数据 | 先删除子表相关数据 |
| `1451` | 23000 | Cannot delete or update parent row | 外键约束阻止删除 | 处理相关子记录后再删除 |
| `1452` | 23000 | Cannot add or update child row | 插入无效外键 | 确保外键值在父表中存在 |

### 3.3 MySQL数据类型相关错误


| 错误码 | **问题** | **通俗解释** | **解决方案** |
|-------|---------|-------------|-------------|
| `1264` | 数据超出列范围 | 数字太大装不下 | 使用更大的数据类型 |
| `1265` | 数据被截断 | 字符串太长被切断 | 增加字段长度或减少数据长度 |
| `1292` | 日期值不正确 | 日期格式写错了 | 使用正确的日期格式 |
| `1366` | 字符集转换错误 | 中文字符显示异常 | 统一使用UTF8字符集 |

### 3.4 MySQL性能和资源错误


| 错误码 | **问题原因** | **影响** | **解决思路** |
|-------|-------------|---------|-------------|
| `1040` | 连接数过多 | 新用户无法连接 | 调整max_connections参数 |
| `1114` | 表已满 | 无法插入新数据 | 清理数据或扩展存储 |
| `1205` | 锁等待超时 | 事务等待时间过长 | 优化事务逻辑，减少锁定时间 |
| `1213` | 死锁检测 | 多个事务相互等待 | 重新设计事务顺序 |

---

## 4. 🏛️ Oracle错误码详解


### 4.1 Oracle错误码特点


**Oracle错误码规律**：
- 使用`ORA-`前缀 + 5位数字（如ORA-00942）
- 错误码范围很广，从00000到65535
- 每个错误都有详细的官方文档说明

### 4.2 Oracle常见错误分类


#### 🔗 连接和会话错误


| 错误码 | **SQLState** | **错误描述** | **通俗含义** | **解决方法** |
|-------|-------------|-------------|-------------|-------------|
| `ORA-01017` | 28000 | Invalid username/password | 用户名密码错误 | 检查登录凭据 |
| `ORA-01034` | 08006 | Oracle not available | Oracle服务未启动 | 启动Oracle服务 |
| `ORA-12154` | 08001 | TNS: could not resolve | 连接标识符无法解析 | 检查tnsnames.ora配置 |
| `ORA-12505` | 08001 | TNS: listener does not know of SID | 监听器不认识指定的SID | 检查SID名称和监听器配置 |
| `ORA-12545` | 08001 | Connect failed because target host or object does not exist | 目标主机不存在 | 检查主机地址 |

#### 📊 对象访问错误


| 错误码 | **SQLState** | **含义** | **常见场景** | **解决方案** |
|-------|-------------|---------|-------------|-------------|
| `ORA-00942` | 42000 | Table or view does not exist | 表或视图不存在 | 检查对象名称和权限 |
| `ORA-00904` | 42000 | Invalid identifier | 列名不存在 | 检查列名拼写 |
| `ORA-00955` | 42000 | Name is already used | 对象名已被使用 | 选择不同的名称 |
| `ORA-00957` | 42000 | Duplicate column name | 重复的列名 | 修改列名 |
| `ORA-01031` | 42000 | Insufficient privileges | 权限不足 | 申请相应权限 |

#### 🏗️ SQL语句错误


| 错误码 | **问题类型** | **典型错误** | **解决思路** |
|-------|-------------|-------------|-------------|
| `ORA-00900` | SQL语句未正确结束 | 缺少分号或语句不完整 | 检查SQL语法完整性 |
| `ORA-00936` | 缺少表达式 | SELECT后面没有字段名 | 添加必要的表达式 |
| `ORA-00937` | GROUP BY表达式错误 | 非聚合列未包含在GROUP BY中 | 修正GROUP BY子句 |
| `ORA-00979` | GROUP BY表达式不匹配 | SELECT中的列不在GROUP BY中 | 调整GROUP BY或SELECT |

#### ⚠️ 数据完整性错误


| 错误码 | **SQLState** | **约束类型** | **解决方案** |
|-------|-------------|-------------|-------------|
| `ORA-00001` | 23000 | 违反唯一约束 | 检查重复数据 |
| `ORA-01400` | 23000 | 不能为NULL | 为必填字段提供值 |
| `ORA-02291` | 23000 | 违反父键约束 | 先插入父表数据 |
| `ORA-02292` | 23000 | 违反子键约束 | 先删除子表相关数据 |

### 4.3 Oracle事务和锁定错误


| 错误码 | **问题** | **影响** | **处理方法** |
|-------|---------|---------|-------------|
| `ORA-00060` | 检测到死锁 | 事务被回滚 | 重新执行事务 |
| `ORA-00054` | 资源正忙 | 等待其他事务释放锁 | 稍后重试或优化事务 |
| `ORA-01555` | 快照过旧 | 长时间事务读取一致性问题 | 增大undo表空间或缩短事务 |

### 4.4 Oracle空间和资源错误


| 错误码 | **资源问题** | **解决方案** |
|-------|-------------|-------------|
| `ORA-01653` | 无法扩展表空间 | 增加数据文件或扩大表空间 |
| `ORA-01654` | 无法扩展索引空间 | 扩展索引表空间 |
| `ORA-00020` | 进程数已达上限 | 增加processes参数 |

---

## 5. 🌐 网络连接异常


### 5.1 网络异常分类


**按照问题层次分类**：

```
网络连接问题层次图：
应用层  ┌─────────────────┐
       │  JDBC驱动问题    │
       └─────────────────┘
传输层  ┌─────────────────┐
       │  TCP连接问题     │
       └─────────────────┘
网络层  ┌─────────────────┐
       │  IP路由问题      │
       └─────────────────┘
物理层  ┌─────────────────┐
       │  网络硬件问题     │
       └─────────────────┘
```

### 5.2 常见网络异常详解


#### 🔌 连接建立异常


| 异常类型 | **错误信息关键词** | **可能原因** | **排查方法** |
|---------|-------------------|-------------|-------------|
| `ConnectException` | "Connection refused" | 目标端口未开放 | telnet检查端口连通性 |
| `SocketTimeoutException` | "connect timed out" | 网络延迟过大 | 调整连接超时时间 |
| `UnknownHostException` | "unknown host" | 域名解析失败 | 检查DNS设置或使用IP |
| `NoRouteToHostException` | "No route to host" | 网络路由问题 | 检查网络配置和防火墙 |

**实际排查步骤**：
```
网络连接排查检查表：
□ 1. ping 数据库服务器IP地址
□ 2. telnet 数据库服务器 端口号
□ 3. 检查防火墙设置
□ 4. 确认数据库服务启动状态
□ 5. 验证连接字符串正确性
```

#### 📡 连接保持异常


| 异常情况 | **现象描述** | **根本原因** | **解决方案** |
|---------|-------------|-------------|-------------|
| `连接中断` | "Connection lost" | 网络不稳定或超时 | 启用连接池的心跳检测 |
| `连接泄漏` | "Too many connections" | 连接未正确关闭 | 使用try-with-resources |
| `连接超时` | "Read timed out" | SQL执行时间过长 | 优化SQL或调整超时设置 |

### 5.3 网络配置相关问题


#### ⚙️ 连接池配置问题


**常见配置错误**：
```java
// ❌ 错误配置示例
HikariConfig config = new HikariConfig();
config.setMaximumPoolSize(1000);        // 连接数过大
config.setConnectionTimeout(1000);      // 超时时间过短
config.setIdleTimeout(60000);          // 空闲时间过短

// ✅ 推荐配置
HikariConfig config = new HikariConfig();
config.setMaximumPoolSize(20);          // 合理的连接数
config.setConnectionTimeout(30000);     // 30秒连接超时
config.setIdleTimeout(600000);         // 10分钟空闲超时
config.setMaxLifetime(1800000);        // 30分钟最大生命期
```

#### 🔧 驱动程序问题


| 问题类型 | **症状** | **解决方案** |
|---------|---------|-------------|
| `驱动版本不匹配` | 功能异常或连接失败 | 使用匹配的驱动版本 |
| `驱动包缺失` | ClassNotFoundException | 添加对应数据库驱动依赖 |
| `多驱动冲突` | 连接行为异常 | 清理冲突的驱动包 |

### 5.4 防火墙和安全组问题


**端口开放检查清单**：

```
数据库常用端口对照表：
┌─────────────┬──────────┬───────────────┐
│   数据库    │   端口   │     检查命令    │
├─────────────┼──────────┼───────────────┤
│   MySQL     │   3306   │ telnet ip 3306 │
│   Oracle    │   1521   │ telnet ip 1521 │
│ SQL Server  │   1433   │ telnet ip 1433 │
│ PostgreSQL  │   5432   │ telnet ip 5432 │
└─────────────┴──────────┴───────────────┘
```

**安全组规则配置**：
- **入站规则**：允许应用服务器访问数据库端口
- **出站规则**：允许数据库服务器响应连接请求
- **IP白名单**：限制只有授权IP可以访问

---

## 6. 🔍 异常排查实用技巧


### 6.1 异常信息解读技巧


**分层解读法**：
```
完整异常信息解读步骤：
1. 看异常类型：SQLException、ConnectException等
2. 读错误信息：关键词定位问题领域  
3. 查错误码：SQLState和ErrorCode
4. 分析调用栈：定位问题发生位置
5. 检查配置：数据库连接参数等
```

**关键词快速定位**：

| 关键词 | **问题领域** | **优先检查** |
|-------|-------------|-------------|
| `"Connection"` | 连接问题 | 网络、服务状态、认证 |
| `"Access denied"` | 权限问题 | 用户权限、密码正确性 |
| `"doesn't exist"` | 对象不存在 | 表名、字段名、数据库名 |
| `"Duplicate"` | 重复数据 | 主键、唯一约束 |
| `"timeout"` | 超时问题 | 网络延迟、SQL性能 |

### 6.2 日志分析方法


#### 📝 启用详细日志


**MySQL日志配置**：
```sql
-- 启用慢查询日志
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2;

-- 启用错误日志
SET GLOBAL log_error_verbosity = 3;
```

**应用程序日志配置**：
```java
// 在连接URL中启用日志
String url = "jdbc:mysql://localhost:3306/test" +
             "?useSSL=false" +
             "&logger=com.mysql.cj.log.StandardLogger" +
             "&profileSQL=true";
```

#### 📊 日志模式识别


**常见错误模式**：
- **连接峰值**：某时段连接异常集中 → 可能是连接池配置问题
- **周期性异常**：定时出现的错误 → 可能是定时任务或缓存过期
- **SQL执行异常**：特定SQL反复失败 → SQL语法或性能问题

### 6.3 预防性措施


#### 🛡️ 连接管理最佳实践


**资源管理原则**：
```java
// ✅ 标准的资源管理模式
try (Connection conn = DriverManager.getConnection(url, user, password);
     PreparedStatement stmt = conn.prepareStatement(sql);
     ResultSet rs = stmt.executeQuery()) {
    
    // 业务逻辑处理
    while (rs.next()) {
        // 数据处理
    }
} catch (SQLException e) {
    // 异常处理
    handleException(e);
}
```

#### ⚡ 性能优化建议


**避免常见性能陷阱**：
- **批量操作**：使用`PreparedStatement.addBatch()`
- **连接复用**：使用连接池而非频繁创建连接
- **事务控制**：合理控制事务范围
- **索引优化**：确保查询使用到合适的索引

### 6.4 异常处理策略


#### 🎯 分级处理方法


```java
public class DatabaseExceptionHandler {
    
    public void handleSQLException(SQLException e) {
        String sqlState = e.getSQLState();
        int errorCode = e.getErrorCode();
        
        // 根据SQLState分类处理
        switch (sqlState.substring(0, 2)) {
            case "08": // 连接异常
                handleConnectionError(e);
                break;
            case "23": // 约束违规
                handleConstraintError(e);
                break;
            case "42": // 语法错误
                handleSyntaxError(e);
                break;
            default:
                handleGenericError(e);
        }
    }
    
    private void handleConnectionError(SQLException e) {
        // 连接问题：记录日志，尝试重连
        logger.error("数据库连接异常", e);
        scheduleReconnect();
    }
    
    private void handleConstraintError(SQLException e) {
        // 约束违规：业务逻辑处理
        logger.warn("数据约束违规: {}", e.getMessage());
        // 可以转换为业务异常抛给上层
    }
}
```

#### 🔄 重试机制设计


**智能重试策略**：
```java
public <T> T executeWithRetry(DatabaseOperation<T> operation, int maxRetries) {
    int attempts = 0;
    while (attempts < maxRetries) {
        try {
            return operation.execute();
        } catch (SQLException e) {
            String sqlState = e.getSQLState();
            
            // 只对临时性错误进行重试
            if (isRetryableError(sqlState)) {
                attempts++;
                waitBeforeRetry(attempts);
            } else {
                throw new DatabaseException("不可重试的错误", e);
            }
        }
    }
    throw new DatabaseException("重试次数已用完");
}

private boolean isRetryableError(String sqlState) {
    // SQLTransientException对应的SQLState开头
    return sqlState.startsWith("08") || sqlState.startsWith("40");
}
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的关键概念


```
🔸 JDBC异常体系：了解SQLException的三大分类
🔸 错误码系统：SQLState（通用）+ ErrorCode（特定）
🔸 常见错误模式：连接、权限、语法、约束四大类
🔸 排查思路：分层诊断，从网络到应用逐步排查
🔸 预防措施：规范的资源管理和异常处理
```

### 7.2 实用排查检查表


**快速定位问题的4步法**：

> 📋 **第1步：看异常类型**
> - SQLException → 数据库相关问题
> - ConnectException → 网络连接问题  
> - ClassNotFoundException → 驱动问题

> 🔍 **第2步：分析错误码**
> - 08xxx → 连接问题，检查网络和服务
> - 42xxx → 语法问题，检查SQL语句
> - 23xxx → 数据问题，检查约束和数据

> ⚙️ **第3步：检查配置**
> - 连接URL格式是否正确
> - 用户名密码是否准确
> - 端口和服务是否启动

> 🛠️ **第4步：验证环境**
> - 网络连通性测试
> - 数据库服务状态
> - 权限和防火墙设置

### 7.3 预防性最佳实践


**代码层面**：
- ✅ 总是使用`try-with-resources`管理连接
- ✅ 使用连接池而非直接连接
- ✅ 设置合理的超时时间
- ✅ 实现分级异常处理策略

**运维层面**：
- 📊 启用数据库和应用日志监控
- 🔄 配置连接池健康检查
- 📈 监控关键性能指标
- 🚨 设置异常告警机制

### 7.4 快速参考表


| 问题现象 | **可能原因** | **快速解决** | **深入排查** |
|---------|-------------|-------------|-------------|
| `连接被拒绝` | 用户名密码错误 | 检查认证信息 | 查看数据库用户权限 |
| `表不存在` | 表名错误或未创建 | 检查表名拼写 | 确认数据库和表结构 |
| `字段不存在` | 列名错误 | 检查字段名 | 对比表结构定义 |
| `数据重复` | 违反唯一约束 | 检查重复数据 | 分析约束设计合理性 |
| `连接超时` | 网络或SQL性能问题 | 调整超时设置 | 优化SQL和网络配置 |

**核心记忆要点**：
- 🎯 错误码是定位问题的关键线索
- 🔍 分层排查比盲目尝试更高效  
- 🛡️ 预防胜于治疗，规范编程习惯很重要
- 📚 熟悉常见错误模式，提高排查效率