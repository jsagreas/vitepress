---
title: 3ã€SQLè°ƒè¯•ä¸æ—¥å¿—
---
## ğŸ“š ç›®å½•

1. [SQLè°ƒè¯•åŸºç¡€æ¦‚å¿µ](#1-SQLè°ƒè¯•åŸºç¡€æ¦‚å¿µ)
2. [SQLæ—¥å¿—è®°å½•å®ç°](#2-SQLæ—¥å¿—è®°å½•å®ç°)
3. [å‚æ•°å€¼æ‰“å°ä¸è¿½è¸ª](#3-å‚æ•°å€¼æ‰“å°ä¸è¿½è¸ª)
4. [æ‰§è¡Œæ—¶é—´ç›‘æ§](#4-æ‰§è¡Œæ—¶é—´ç›‘æ§)
5. [æ…¢SQLè¯†åˆ«ä¸ä¼˜åŒ–](#5-æ…¢SQLè¯†åˆ«ä¸ä¼˜åŒ–)
6. [è°ƒè¯•å·¥å…·ä½¿ç”¨æŒ‡å—](#6-è°ƒè¯•å·¥å…·ä½¿ç”¨æŒ‡å—)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” SQLè°ƒè¯•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SQLè°ƒè¯•


**ğŸ¯ é€šä¿—ç†è§£**
```
æƒ³è±¡ä½ åœ¨åšèœï¼š
- æ™®é€šåšèœï¼šæŒ‰é£Ÿè°±åšï¼Œä¸çŸ¥é“æ¯ä¸€æ­¥æ•ˆæœ
- è°ƒè¯•åšèœï¼šè®°å½•æ¯ä¸ªæ­¥éª¤ã€ç”¨æ–™ã€æ—¶é—´ï¼Œå‡ºé—®é¢˜èƒ½å¿«é€Ÿæ‰¾åŸå› 

SQLè°ƒè¯•å°±æ˜¯ï¼š
è®°å½•SQLæ‰§è¡Œçš„å…¨è¿‡ç¨‹ï¼Œå½“å‡ºé—®é¢˜æ—¶èƒ½å¿«é€Ÿå®šä½
```

**ğŸ“‹ æ ¸å¿ƒæ¦‚å¿µ**
- **SQLæ—¥å¿—**ï¼šè®°å½•æ‰§è¡Œçš„SQLè¯­å¥
- **å‚æ•°è®°å½•**ï¼šè®°å½•ä¼ å…¥çš„å…·ä½“å‚æ•°å€¼
- **æ€§èƒ½ç›‘æ§**ï¼šè®°å½•æ‰§è¡Œæ—¶é—´å’Œèµ„æºæ¶ˆè€—
- **é”™è¯¯è¿½è¸ª**ï¼šè®°å½•å¼‚å¸¸ä¿¡æ¯å’Œå‘ç”Ÿä½ç½®

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦SQLè°ƒè¯•


**ğŸ”¥ å®é™…åœºæ™¯é—®é¢˜**
```
å¸¸è§é—®é¢˜ï¼š
âŒ "æŸ¥è¯¢æ€ä¹ˆè¿™ä¹ˆæ…¢ï¼Ÿ"
âŒ "ä¸ºä»€ä¹ˆæŸ¥ä¸åˆ°æ•°æ®ï¼Ÿ"
âŒ "SQLæ‰§è¡ŒæŠ¥é”™äº†ï¼Œä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜"
âŒ "ç³»ç»Ÿçªç„¶å¡äº†ï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªSQLå¯¼è‡´çš„"

æœ‰äº†è°ƒè¯•åï¼š
âœ… èƒ½çœ‹åˆ°å…·ä½“æ‰§è¡Œçš„SQLè¯­å¥
âœ… çŸ¥é“å‚æ•°ä¼ é€’æ˜¯å¦æ­£ç¡®
âœ… æ¸…æ¥šæ¯ä¸ªSQLçš„æ‰§è¡Œæ—¶é—´
âœ… å¿«é€Ÿå®šä½æ…¢SQLå’Œå¼‚å¸¸SQL
```

### 1.3 è°ƒè¯•çš„æ ¸å¿ƒä»·å€¼


**ğŸ’¡ å¼€å‘é˜¶æ®µä»·å€¼**
- ğŸ“– **å­¦ä¹ ç†è§£**ï¼šçœ‹åˆ°JDBCå¦‚ä½•å°†Javaä»£ç è½¬æ¢ä¸ºSQL
- ğŸ› **é”™è¯¯å®šä½**ï¼šå¿«é€Ÿæ‰¾åˆ°SQLè¯­æ³•é”™è¯¯æˆ–é€»è¾‘é”™è¯¯
- ğŸ“Š **æ€§èƒ½åˆ†æ**ï¼šå‘ç°å“ªäº›æ“ä½œæ¯”è¾ƒè€—æ—¶

**ğŸš€ ç”Ÿäº§ç¯å¢ƒä»·å€¼**
- ğŸ” **é—®é¢˜è¯Šæ–­**ï¼šå¿«é€Ÿå®šä½çº¿ä¸Šé—®é¢˜
- ğŸ“ˆ **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯†åˆ«éœ€è¦ä¼˜åŒ–çš„SQL
- ğŸ“‹ **è¿ç»´ç›‘æ§**ï¼šç›‘æ§æ•°æ®åº“è®¿é—®æƒ…å†µ

---

## 2. ğŸ“ SQLæ—¥å¿—è®°å½•å®ç°


### 2.1 åŸºç¡€æ—¥å¿—è®°å½•


**ğŸ”§ ç®€å•æ—¥å¿—å®ç°**
```java
public class JDBCLogger {
    private static final Logger logger = LoggerFactory.getLogger(JDBCLogger.class);
    
    // è®°å½•SQLæ‰§è¡Œ
    public static void logSQL(String sql) {
        logger.info("ğŸ” æ‰§è¡ŒSQL: {}", sql);
    }
    
    // è®°å½•SQLå’Œå‚æ•°
    public static void logSQLWithParams(String sql, Object... params) {
        logger.info("ğŸ” æ‰§è¡ŒSQL: {}", sql);
        if (params != null && params.length > 0) {
            logger.info("ğŸ“ å‚æ•°: {}", Arrays.toString(params));
        }
    }
}
```

**ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹**
```java
public User findUserById(int id) {
    String sql = "SELECT * FROM user WHERE id = ?";
    
    // è®°å½•å³å°†æ‰§è¡Œçš„SQL
    JDBCLogger.logSQLWithParams(sql, id);
    
    try (PreparedStatement pstmt = connection.prepareStatement(sql)) {
        pstmt.setInt(1, id);
        ResultSet rs = pstmt.executeQuery();
        
        // ... å¤„ç†ç»“æœ
    } catch (SQLException e) {
        logger.error("âŒ SQLæ‰§è¡Œå¤±è´¥: {}", sql, e);
        throw e;
    }
}
```

### 2.2 é…ç½®åŒ–æ—¥å¿—è®°å½•


**âš™ï¸ æ—¥å¿—é…ç½®æ–‡ä»¶(logback.xml)**
```xml
<configuration>
    <!-- SQLä¸“ç”¨æ—¥å¿—å™¨ -->
    <logger name="com.example.jdbc.sql" level="DEBUG" additivity="false">
        <appender-ref ref="SQL_FILE" />
    </logger>
    
    <!-- SQLæ–‡ä»¶è¾“å‡º -->
    <appender name="SQL_FILE" class="ch.qos.logback.core.FileAppender">
        <file>logs/sql.log</file>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%thread] - %msg%n</pattern>
        </encoder>
    </appender>
</configuration>
```

**ğŸ›ï¸ å¯é…ç½®çš„æ—¥å¿—å·¥å…·**
```java
public class ConfigurableJDBCLogger {
    private static final Logger sqlLogger = LoggerFactory.getLogger("com.example.jdbc.sql");
    private static boolean enableSQLLog = true;
    private static boolean enableParamLog = true;
    private static boolean enableTimeLog = true;
    
    public static void logSQLExecution(String sql, Object[] params, long executeTime) {
        if (!enableSQLLog) return;
        
        StringBuilder logMsg = new StringBuilder();
        logMsg.append("ğŸ” SQL: ").append(sql);
        
        if (enableParamLog && params != null && params.length > 0) {
            logMsg.append(" | ğŸ“ å‚æ•°: ").append(Arrays.toString(params));
        }
        
        if (enableTimeLog) {
            logMsg.append(" | â±ï¸ è€—æ—¶: ").append(executeTime).append("ms");
        }
        
        sqlLogger.debug(logMsg.toString());
    }
}
```

### 2.3 æ™ºèƒ½SQLæ ¼å¼åŒ–


**ğŸ¨ SQLç¾åŒ–å·¥å…·**
```java
public class SQLFormatter {
    
    public static String formatSQL(String sql) {
        return sql.replaceAll("\\s+", " ")  // ç»Ÿä¸€ç©ºæ ¼
                  .replace(" SELECT ", "\nSELECT ")
                  .replace(" FROM ", "\nFROM ")
                  .replace(" WHERE ", "\nWHERE ")
                  .replace(" ORDER BY ", "\nORDER BY ")
                  .replace(" GROUP BY ", "\nGROUP BY ")
                  .replace(",", ",\n    ")
                  .trim();
    }
    
    public static void logFormattedSQL(String sql, Object... params) {
        logger.info("ğŸ” æ‰§è¡ŒSQL:\n{}", formatSQL(sql));
        if (params != null && params.length > 0) {
            logger.info("ğŸ“ å‚æ•°: {}", Arrays.toString(params));
        }
    }
}
```

---

## 3. ğŸ“‹ å‚æ•°å€¼æ‰“å°ä¸è¿½è¸ª


### 3.1 å‚æ•°è®°å½•çš„é‡è¦æ€§


**â“ ä¸ºä»€ä¹ˆè¦è®°å½•å‚æ•°**
```
æ²¡æœ‰å‚æ•°è®°å½•çš„é—®é¢˜ï¼š
SQL: "SELECT * FROM user WHERE age > ? AND name LIKE ?"
âŒ ä¸çŸ¥é“å…·ä½“æŸ¥è¯¢æ¡ä»¶æ˜¯ä»€ä¹ˆ
âŒ æ— æ³•é‡ç°é—®é¢˜
âŒ ä¸çŸ¥é“æ˜¯å‚æ•°é—®é¢˜è¿˜æ˜¯SQLé—®é¢˜

æœ‰å‚æ•°è®°å½•åï¼š
SQL: "SELECT * FROM user WHERE age > ? AND name LIKE ?"
å‚æ•°: [18, "%å¼ %"]
âœ… èƒ½çœ‹åˆ°å…·ä½“çš„æŸ¥è¯¢æ¡ä»¶
âœ… å¯ä»¥ç›´æ¥æ‹·è´åˆ°æ•°æ®åº“å·¥å…·ä¸­æµ‹è¯•
âœ… èƒ½åˆ¤æ–­å‚æ•°æ˜¯å¦æ­£ç¡®
```

### 3.2 ä¸åŒç±»å‹å‚æ•°çš„æ‰“å°


**ğŸ”¢ åŸºç¡€å‚æ•°æ‰“å°å™¨**
```java
public class ParameterPrinter {
    
    public static String formatParameter(Object param) {
        if (param == null) {
            return "NULL";
        }
        
        if (param instanceof String) {
            return "'" + param + "'";
        }
        
        if (param instanceof Date) {
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            return "'" + sdf.format((Date) param) + "'";
        }
        
        if (param instanceof BigDecimal) {
            return param.toString();
        }
        
        return String.valueOf(param);
    }
    
    public static String buildExecutableSQL(String sql, Object... params) {
        String result = sql;
        for (Object param : params) {
            result = result.replaceFirst("\\?", formatParameter(param));
        }
        return result;
    }
}
```

**ğŸ“Š å‚æ•°ç»Ÿè®¡åˆ†æ**
```java
public class ParameterAnalyzer {
    private static final Map<String, Integer> paramTypeCount = new HashMap<>();
    
    public static void analyzeParameters(Object... params) {
        for (Object param : params) {
            String type = param != null ? param.getClass().getSimpleName() : "NULL";
            paramTypeCount.merge(type, 1, Integer::sum);
        }
    }
    
    public static void printParameterStatistics() {
        logger.info("ğŸ“Š å‚æ•°ç±»å‹ç»Ÿè®¡:");
        paramTypeCount.forEach((type, count) -> 
            logger.info("  {} : {} æ¬¡", type, count));
    }
}
```

### 3.3 å‚æ•°è¿½è¸ªé“¾è·¯


**ğŸ”— å‚æ•°ä¼ é€’é“¾è·¯è¿½è¸ª**
```java
public class ParameterTracker {
    private static final ThreadLocal<List<String>> parameterTrace = 
        ThreadLocal.withInitial(ArrayList::new);
    
    public static void startTrace(String methodName) {
        parameterTrace.get().clear();
        parameterTrace.get().add("å¼€å§‹è¿½è¸ª: " + methodName);
    }
    
    public static void traceParameter(String step, Object... params) {
        String trace = String.format("%s - å‚æ•°: %s", step, Arrays.toString(params));
        parameterTrace.get().add(trace);
    }
    
    public static void endTrace() {
        List<String> traces = parameterTrace.get();
        logger.info("ğŸ”— å‚æ•°è¿½è¸ªé“¾è·¯:");
        traces.forEach(trace -> logger.info("  â””â”€ {}", trace));
        parameterTrace.remove();
    }
}
```

---

## 4. â±ï¸ æ‰§è¡Œæ—¶é—´ç›‘æ§


### 4.1 åŸºç¡€æ—¶é—´ç›‘æ§


**â° ç®€å•è®¡æ—¶å™¨**
```java
public class SQLTimer {
    private static final ThreadLocal<Long> startTime = new ThreadLocal<>();
    
    public static void start() {
        startTime.set(System.currentTimeMillis());
    }
    
    public static long end() {
        Long start = startTime.get();
        if (start == null) return 0;
        
        long duration = System.currentTimeMillis() - start;
        startTime.remove();
        return duration;
    }
    
    public static void logExecutionTime(String sql, long duration) {
        String level = duration > 1000 ? "WARN" : "INFO";
        String emoji = duration > 1000 ? "ğŸŒ" : "âš¡";
        
        logger.info("{} SQLæ‰§è¡Œè€—æ—¶: {}ms - {}", emoji, duration, sql);
    }
}
```

**ğŸ“ˆ ä½¿ç”¨ç¤ºä¾‹**
```java
public List<User> findUsers(String condition) {
    String sql = "SELECT * FROM user WHERE " + condition;
    
    SQLTimer.start();  // å¼€å§‹è®¡æ—¶
    
    try (PreparedStatement pstmt = connection.prepareStatement(sql)) {
        ResultSet rs = pstmt.executeQuery();
        List<User> users = new ArrayList<>();
        
        while (rs.next()) {
            users.add(mapToUser(rs));
        }
        
        long duration = SQLTimer.end();  // ç»“æŸè®¡æ—¶
        SQLTimer.logExecutionTime(sql, duration);
        
        return users;
    }
}
```

### 4.2 è¯¦ç»†æ€§èƒ½ç›‘æ§


**ğŸ“Š æ€§èƒ½ç»Ÿè®¡å™¨**
```java
public class SQLPerformanceMonitor {
    
    public static class SQLStats {
        public String sql;
        public int executeCount = 0;
        public long totalTime = 0;
        public long maxTime = 0;
        public long minTime = Long.MAX_VALUE;
        
        public double getAverageTime() {
            return executeCount > 0 ? (double) totalTime / executeCount : 0;
        }
        
        public void addExecution(long duration) {
            executeCount++;
            totalTime += duration;
            maxTime = Math.max(maxTime, duration);
            minTime = Math.min(minTime, duration);
        }
    }
    
    private static final Map<String, SQLStats> sqlStatsMap = new ConcurrentHashMap<>();
    
    public static void recordExecution(String sql, long duration) {
        sqlStatsMap.computeIfAbsent(sql, k -> new SQLStats()).addExecution(duration);
    }
    
    public static void printPerformanceReport() {
        logger.info("ğŸ“Š SQLæ€§èƒ½æŠ¥å‘Š:");
        logger.info("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
        
        sqlStatsMap.entrySet().stream()
            .sorted((e1, e2) -> Long.compare(e2.getValue().totalTime, e1.getValue().totalTime))
            .limit(10)
            .forEach(entry -> {
                SQLStats stats = entry.getValue();
                logger.info("SQL: {}", entry.getKey());
                logger.info("  æ‰§è¡Œæ¬¡æ•°: {} æ¬¡", stats.executeCount);
                logger.info("  å¹³å‡è€—æ—¶: {:.2f}ms", stats.getAverageTime());
                logger.info("  æœ€å¤§è€—æ—¶: {}ms", stats.maxTime);
                logger.info("  æ€»è€—æ—¶: {}ms", stats.totalTime);
                logger.info("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
            });
    }
}
```

### 4.3 å®æ—¶æ€§èƒ½ç›‘æ§


**ğŸ“¡ å®æ—¶ç›‘æ§é¢æ¿**
```java
public class RealTimeMonitor {
    private static final int SAMPLE_SIZE = 100;
    private static final Queue<Long> recentExecutions = new ConcurrentLinkedQueue<>();
    
    public static void recordExecution(long duration) {
        recentExecutions.offer(duration);
        if (recentExecutions.size() > SAMPLE_SIZE) {
            recentExecutions.poll();
        }
        
        // å¦‚æœæ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œç«‹å³å‘Šè­¦
        if (duration > 5000) {
            logger.warn("ğŸš¨ å‘ç°æ…¢SQL! æ‰§è¡Œæ—¶é—´: {}ms", duration);
        }
    }
    
    public static void printRealtimeStats() {
        if (recentExecutions.isEmpty()) return;
        
        double avgTime = recentExecutions.stream()
            .mapToLong(Long::longValue)
            .average()
            .orElse(0.0);
            
        long maxTime = recentExecutions.stream()
            .mapToLong(Long::longValue)
            .max()
            .orElse(0L);
            
        logger.info("ğŸ“Š æœ€è¿‘{}æ¬¡æ‰§è¡Œ - å¹³å‡: {:.2f}ms, æœ€å¤§: {}ms", 
                   recentExecutions.size(), avgTime, maxTime);
    }
}
```

---

## 5. ğŸŒ æ…¢SQLè¯†åˆ«ä¸ä¼˜åŒ–


### 5.1 æ…¢SQLè¯†åˆ«ç­–ç•¥


**ğŸ¯ æ…¢SQLè¯†åˆ«é…ç½®**
```java
public class SlowSQLDetector {
    
    // é…ç½®ä¸åŒçº§åˆ«çš„æ—¶é—´é˜ˆå€¼
    private static final long WARNING_THRESHOLD = 1000;   // 1ç§’è­¦å‘Š
    private static final long SLOW_THRESHOLD = 3000;      // 3ç§’æ…¢SQL
    private static final long CRITICAL_THRESHOLD = 10000; // 10ç§’ä¸¥é‡

    public static void checkExecutionTime(String sql, long duration) {
        if (duration > CRITICAL_THRESHOLD) {
            logger.error("ğŸ”´ ä¸¥é‡æ…¢SQL ({}ms): {}", duration, sql);
            // å¯ä»¥å‘é€å‘Šè­¦é€šçŸ¥
            sendAlert("ä¸¥é‡æ…¢SQLå‘Šè­¦", sql, duration);
            
        } else if (duration > SLOW_THRESHOLD) {
            logger.warn("ğŸŸ¡ æ…¢SQLæ£€æµ‹ ({}ms): {}", duration, sql);
            
        } else if (duration > WARNING_THRESHOLD) {
            logger.info("ğŸŸ  SQLæ‰§è¡Œè¾ƒæ…¢ ({}ms): {}", duration, sql);
        }
    }
    
    private static void sendAlert(String title, String sql, long duration) {
        // è¿™é‡Œå¯ä»¥é›†æˆé‚®ä»¶ã€çŸ­ä¿¡ç­‰å‘Šè­¦æ–¹å¼
        logger.error("ğŸ“§ å‘é€å‘Šè­¦: {} - SQL:{} è€—æ—¶:{}ms", title, sql, duration);
    }
}
```

### 5.2 æ…¢SQLåˆ†æå·¥å…·


**ğŸ” æ…¢SQLåˆ†æå™¨**
```java
public class SlowSQLAnalyzer {
    
    public static class SlowSQLRecord {
        public String sql;
        public Object[] parameters;
        public long duration;
        public String stackTrace;
        public Date executeTime;
        
        public SlowSQLRecord(String sql, Object[] parameters, long duration) {
            this.sql = sql;
            this.parameters = parameters;
            this.duration = duration;
            this.executeTime = new Date();
            this.stackTrace = getCurrentStackTrace();
        }
        
        private String getCurrentStackTrace() {
            return Thread.currentThread().getStackTrace()[3].toString();
        }
    }
    
    private static final List<SlowSQLRecord> slowSQLRecords = new ArrayList<>();
    
    public static void recordSlowSQL(String sql, Object[] params, long duration) {
        if (duration > 1000) {  // è¶…è¿‡1ç§’è®°å½•
            slowSQLRecords.add(new SlowSQLRecord(sql, params, duration));
            
            // ä¿æŒè®°å½•æ•°é‡åˆç†
            if (slowSQLRecords.size() > 1000) {
                slowSQLRecords.removeIf(record -> 
                    System.currentTimeMillis() - record.executeTime.getTime() > 24 * 60 * 60 * 1000);
            }
        }
    }
    
    public static void generateSlowSQLReport() {
        logger.info("ğŸ“‹ æ…¢SQLåˆ†ææŠ¥å‘Š (æœ€è¿‘24å°æ—¶):");
        logger.info("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        
        slowSQLRecords.stream()
            .sorted((r1, r2) -> Long.compare(r2.duration, r1.duration))
            .limit(20)
            .forEach(record -> {
                logger.info("â±ï¸ è€—æ—¶: {}ms", record.duration);
                logger.info("ğŸ” SQL: {}", record.sql);
                logger.info("ğŸ“ å‚æ•°: {}", Arrays.toString(record.parameters));
                logger.info("ğŸ“ è°ƒç”¨ä½ç½®: {}", record.stackTrace);
                logger.info("ğŸ• æ‰§è¡Œæ—¶é—´: {}", record.executeTime);
                logger.info("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
            });
    }
}
```

### 5.3 SQLä¼˜åŒ–å»ºè®®


**ğŸ’¡ è‡ªåŠ¨ä¼˜åŒ–å»ºè®®**
```java
public class SQLOptimizationAdvisor {
    
    public static void analyzeAndSuggest(String sql, long duration) {
        List<String> suggestions = new ArrayList<>();
        
        // åˆ†æSQLç»“æ„ç»™å‡ºå»ºè®®
        if (sql.toUpperCase().contains("SELECT *")) {
            suggestions.add("ğŸ”¸ é¿å…ä½¿ç”¨SELECT *ï¼Œæ˜ç¡®æŒ‡å®šéœ€è¦çš„åˆ—");
        }
        
        if (!sql.toUpperCase().contains("WHERE") && sql.toUpperCase().contains("SELECT")) {
            suggestions.add("ğŸ”¸ è€ƒè™‘æ·»åŠ WHEREæ¡ä»¶é™åˆ¶æŸ¥è¯¢èŒƒå›´");
        }
        
        if (sql.toUpperCase().contains("ORDER BY") && !sql.toUpperCase().contains("LIMIT")) {
            suggestions.add("ğŸ”¸ æ’åºæŸ¥è¯¢å»ºè®®æ·»åŠ LIMITé™åˆ¶ç»“æœæ•°é‡");
        }
        
        if (duration > 3000) {
            suggestions.add("ğŸ”¸ æ‰§è¡Œæ—¶é—´è¶…è¿‡3ç§’ï¼Œå»ºè®®æ£€æŸ¥ç´¢å¼•å’ŒæŸ¥è¯¢æ¡ä»¶");
            suggestions.add("ğŸ”¸ å¯ä»¥ä½¿ç”¨EXPLAINåˆ†ææ‰§è¡Œè®¡åˆ’");
        }
        
        if (!suggestions.isEmpty()) {
            logger.info("ğŸ’¡ SQLä¼˜åŒ–å»ºè®®:");
            suggestions.forEach(suggestion -> logger.info("  {}", suggestion));
        }
    }
}
```

---

## 6. ğŸ› ï¸ è°ƒè¯•å·¥å…·ä½¿ç”¨æŒ‡å—


### 6.1 IDEé›†æˆè°ƒè¯•


**ğŸ”§ Eclipse/IntelliJ IDEAè°ƒè¯•æŠ€å·§**

```
è°ƒè¯•PreparedStatementçš„æŠ€å·§ï¼š

1. è®¾ç½®æ–­ç‚¹ä½ç½®ï¼š
   âœ… pstmt.setXXX() æ–¹æ³•ä¸Š - æŸ¥çœ‹å‚æ•°è®¾ç½®
   âœ… pstmt.executeQuery() å‰ - æŸ¥çœ‹æœ€ç»ˆSQL
   âœ… ResultSetå¤„ç†å¾ªç¯ä¸­ - æŸ¥çœ‹æŸ¥è¯¢ç»“æœ

2. æŸ¥çœ‹å˜é‡å€¼ï¼š
   ğŸ“ åœ¨Variablesé¢æ¿æŸ¥çœ‹pstmtå¯¹è±¡
   ğŸ“ å±•å¼€pstmtå†…éƒ¨å±æ€§æŸ¥çœ‹SQLè¯­å¥
   ğŸ“ æŸ¥çœ‹å‚æ•°æ•°ç»„çš„å…·ä½“å€¼
```

**ğŸ“‹ è°ƒè¯•ä¿¡æ¯è¾“å‡º**
```java
public class IDEDebugHelper {
    
    public static void debugPreparedStatement(PreparedStatement pstmt) {
        try {
            // é€šè¿‡åå°„è·å–å†…éƒ¨SQLï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
            Field sqlField = pstmt.getClass().getDeclaredField("sql");
            sqlField.setAccessible(true);
            String sql = (String) sqlField.get(pstmt);
            
            logger.debug("ğŸ” IDEè°ƒè¯• - å½“å‰SQL: {}", sql);
            
        } catch (Exception e) {
            logger.debug("ğŸ” IDEè°ƒè¯• - æ— æ³•è·å–å†…éƒ¨SQL: {}", e.getMessage());
        }
    }
    
    public static void debugResultSet(ResultSet rs) throws SQLException {
        ResultSetMetaData metaData = rs.getMetaData();
        int columnCount = metaData.getColumnCount();
        
        logger.debug("ğŸ“Š ResultSetç»“æ„ä¿¡æ¯:");
        for (int i = 1; i <= columnCount; i++) {
            logger.debug("  åˆ—{}: {} ({})", i, 
                metaData.getColumnName(i), 
                metaData.getColumnTypeName(i));
        }
    }
}
```

### 6.2 æ•°æ®åº“å·¥å…·é›†æˆ


**ğŸ—ƒï¸ æ•°æ®åº“è¿æ¥è°ƒè¯•**
```java
public class DatabaseToolsIntegration {
    
    // ç”Ÿæˆå¯ä»¥ç›´æ¥åœ¨æ•°æ®åº“å·¥å…·ä¸­æ‰§è¡Œçš„SQL
    public static void generateExecutableSQL(String sql, Object... params) {
        String executableSQL = sql;
        
        for (Object param : params) {
            if (param instanceof String) {
                executableSQL = executableSQL.replaceFirst("\\?", "'" + param + "'");
            } else if (param instanceof Date) {
                SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                executableSQL = executableSQL.replaceFirst("\\?", "'" + sdf.format(param) + "'");
            } else {
                executableSQL = executableSQL.replaceFirst("\\?", String.valueOf(param));
            }
        }
        
        logger.info("ğŸ”— å¯æ‰§è¡ŒSQL (å¤åˆ¶åˆ°æ•°æ®åº“å·¥å…·ä¸­æµ‹è¯•):");
        logger.info("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
        logger.info(executableSQL);
        logger.info("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
    }
    
    // ç”Ÿæˆæ€§èƒ½åˆ†æSQL
    public static void generateExplainSQL(String sql, Object... params) {
        String explainSQL = "EXPLAIN " + generateExecutableSQL(sql, params);
        logger.info("ğŸ“Š æ€§èƒ½åˆ†æSQL:");
        logger.info(explainSQL);
    }
}
```

### 6.3 ç¬¬ä¸‰æ–¹è°ƒè¯•å·¥å…·


**ğŸ“¦ P6Spyé›†æˆä½¿ç”¨**

> **ğŸ’¡ ä»€ä¹ˆæ˜¯P6Spy**: P6Spyæ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®åº“ç›‘æ§å·¥å…·ï¼Œå¯ä»¥æ‹¦æˆªå’Œè®°å½•æ‰€æœ‰æ•°æ®åº“æ“ä½œ

**é…ç½®æ­¥éª¤:**

1. **æ·»åŠ ä¾èµ–**
```xml
<dependency>
    <groupId>p6spy</groupId>
    <artifactId>p6spy</artifactId>
    <version>3.9.1</version>
</dependency>
```

2. **ä¿®æ”¹æ•°æ®åº“è¿æ¥**
```java
// åŸæ¥çš„è¿æ¥
String url = "jdbc:mysql://localhost:3306/testdb";

// ä½¿ç”¨P6Spyçš„è¿æ¥
String url = "jdbc:p6spy:mysql://localhost:3306/testdb";
String driver = "com.p6spy.engine.spy.P6SpyDriver";
```

3. **é…ç½®æ–‡ä»¶(spy.properties)**
```properties
# æŒ‡å®šçœŸå®é©±åŠ¨
realdriver=com.mysql.cj.jdbc.Driver

# æ—¥å¿—è¾“å‡ºæ ¼å¼
logMessageFormat=com.p6spy.engine.spy.appender.MultiLineFormat

# è¾“å‡ºåˆ°æ–‡ä»¶
appender=com.p6spy.engine.spy.appender.FileLogger
logfile=logs/p6spy.log

# æ˜¯å¦æ˜¾ç¤ºæ‰§è¡Œæ—¶é—´
executionThreshold=100
```

**ğŸ“Š P6Spyè¾“å‡ºç¤ºä¾‹**
```
1693234567890|12|statement|connection 0|SELECT * FROM user WHERE age > ?|SELECT * FROM user WHERE age > 18
1693234567902|0|resultset|connection 0|SELECT * FROM user WHERE age > 18|è¿”å› 3 è¡Œæ•°æ®
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¥ å…³é”®çŸ¥è¯†ç‚¹å›é¡¾**
```
ğŸ¯ SQLè°ƒè¯•çš„ç›®çš„ï¼š
  â”œâ”€ ğŸ” å¿«é€Ÿå®šä½é—®é¢˜ï¼šçœ‹åˆ°å…·ä½“æ‰§è¡Œçš„SQLå’Œå‚æ•°
  â”œâ”€ â±ï¸ æ€§èƒ½ç›‘æ§ï¼šè¯†åˆ«æ…¢SQLå’Œæ€§èƒ½ç“¶é¢ˆ
  â”œâ”€ ğŸ“Š è¿ç»´ç›‘æ§ï¼šäº†è§£ç³»ç»Ÿæ•°æ®åº“è®¿é—®æƒ…å†µ
  â””â”€ ğŸ› é”™è¯¯è¯Šæ–­ï¼šå¿«é€Ÿæ‰¾åˆ°SQLé”™è¯¯åŸå› 

ğŸ› ï¸ è°ƒè¯•å®ç°æ–¹å¼ï¼š
  â”œâ”€ ğŸ“ æ—¥å¿—è®°å½•ï¼šè®°å½•SQLè¯­å¥å’Œå‚æ•°
  â”œâ”€ â° æ—¶é—´ç›‘æ§ï¼šç›‘æ§æ‰§è¡Œè€—æ—¶
  â”œâ”€ ğŸ” å‚æ•°è¿½è¸ªï¼šè·Ÿè¸ªå‚æ•°ä¼ é€’è¿‡ç¨‹
  â””â”€ ğŸ“Š æ€§èƒ½åˆ†æï¼šç»Ÿè®¡å’Œåˆ†æSQLæ€§èƒ½
```

### 7.2 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“‹ å¼€å‘é˜¶æ®µæœ€ä½³å®è·µ**
```
æ–°æ‰‹å¼€å‘å»ºè®®ï¼š
âœ… å¼€å¯SQLæ—¥å¿—ï¼Œçœ‹æ¸…æ¥šå®é™…æ‰§è¡Œçš„SQL
âœ… è®°å½•å‚æ•°å€¼ï¼Œç¡®ä¿å‚æ•°ä¼ é€’æ­£ç¡®
âœ… ç›‘æ§æ‰§è¡Œæ—¶é—´ï¼ŒåŠæ—©å‘ç°æ€§èƒ½é—®é¢˜
âœ… ä½¿ç”¨æ•°æ®åº“å·¥å…·éªŒè¯SQLæ­£ç¡®æ€§

è¿›é˜¶æŠ€å·§ï¼š
âœ… é…ç½®æ…¢SQLç›‘æ§ï¼Œè®¾ç½®åˆç†é˜ˆå€¼
âœ… ä½¿ç”¨æ€§èƒ½ç»Ÿè®¡ï¼Œäº†è§£ç³»ç»Ÿæ•´ä½“æƒ…å†µ
âœ… é›†æˆç¬¬ä¸‰æ–¹å·¥å…·ï¼Œè·å¾—æ›´è¯¦ç»†ä¿¡æ¯
âœ… å»ºç«‹å‘Šè­¦æœºåˆ¶ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
```

**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹**
```
æ€§èƒ½è€ƒè™‘ï¼š
âš ï¸ ä¸è¦è®°å½•æ‰€æœ‰SQLï¼Œå½±å“æ€§èƒ½
âš ï¸ åˆç†è®¾ç½®æ—¥å¿—çº§åˆ«å’Œè¾“å‡ºæ ¼å¼
âš ï¸ å®šæœŸæ¸…ç†å†å²è°ƒè¯•ä¿¡æ¯
âš ï¸ æ•æ„Ÿå‚æ•°è¦è„±æ•å¤„ç†

ç›‘æ§é‡ç‚¹ï¼š
ğŸ” é‡ç‚¹ç›‘æ§æ…¢SQLå’Œå¼‚å¸¸SQL
ğŸ“Š å…³æ³¨æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
ğŸ“ˆ ç›‘æ§æ•´ä½“æ€§èƒ½è¶‹åŠ¿
ğŸš¨ å»ºç«‹å‘Šè­¦å’Œé€šçŸ¥æœºåˆ¶
```

### 7.3 å¸¸è§é—®é¢˜è§£å†³


| é—®é¢˜åœºæ™¯ | **ç°è±¡** | **è°ƒè¯•æ–¹æ³•** | **è§£å†³æ€è·¯** |
|---------|----------|--------------|-------------|
| ğŸ” **æŸ¥è¯¢æ— ç»“æœ** | `è¿”å›ç©ºListæˆ–null` | `è®°å½•SQLå’Œå‚æ•°` | `æ£€æŸ¥WHEREæ¡ä»¶å’Œå‚æ•°å€¼` |
| â° **æŸ¥è¯¢å¾ˆæ…¢** | `å“åº”æ—¶é—´é•¿` | `ç›‘æ§æ‰§è¡Œæ—¶é—´` | `åˆ†æSQLæ‰§è¡Œè®¡åˆ’ï¼Œæ£€æŸ¥ç´¢å¼•` |
| âŒ **SQLæ‰§è¡Œé”™è¯¯** | `SQLExceptionå¼‚å¸¸` | `è®°å½•å®Œæ•´é”™è¯¯ä¿¡æ¯` | `æ£€æŸ¥SQLè¯­æ³•å’Œè¡¨ç»“æ„` |
| ğŸ”„ **å‚æ•°ä¼ é€’é”™è¯¯** | `æŸ¥è¯¢ç»“æœä¸ç¬¦åˆé¢„æœŸ` | `æ‰“å°å‚æ•°å€¼` | `æ£€æŸ¥å‚æ•°ç±»å‹å’Œé¡ºåº` |

### 7.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸš€ å­¦ä¹ å»ºè®®**
```
ğŸ“š åŸºç¡€é˜¶æ®µï¼š
  â””â”€ æŒæ¡åŸºæœ¬çš„æ—¥å¿—è®°å½•å’Œå‚æ•°æ‰“å°

ğŸ“ˆ è¿›é˜¶é˜¶æ®µï¼š
  â””â”€ å­¦ä¼šæ€§èƒ½ç›‘æ§å’Œæ…¢SQLè¯†åˆ«

ğŸ¯ é«˜çº§é˜¶æ®µï¼š
  â””â”€ ä½¿ç”¨ä¸“ä¸šå·¥å…·å’Œè‡ªåŠ¨åŒ–åˆ†æ

ğŸ”§ å®æˆ˜é˜¶æ®µï¼š
  â””â”€ å»ºç«‹å®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
```

**ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**
```
SQLè°ƒè¯•æœ‰æ–¹æ³•ï¼Œæ—¥å¿—å‚æ•°è¦è®°ç‰¢
æ‰§è¡Œæ—¶é—´è¦ç›‘æ§ï¼Œæ…¢SQLè¯†åˆ«å¾ˆé‡è¦
å·¥å…·é›†æˆåŠ©è°ƒè¯•ï¼Œé—®é¢˜å®šä½æ•ˆç‡é«˜
ç”Ÿäº§ç¯å¢ƒéœ€è°¨æ…ï¼Œç›‘æ§å‘Šè­¦ä¸å¯å°‘
```

**ğŸ’¡ å…³é”®ç†è§£è¦ç‚¹**
- **è°ƒè¯•ä¸æ˜¯å¯é€‰é¡¹**ï¼šæ˜¯JDBCå¼€å‘çš„å¿…å¤‡æŠ€èƒ½
- **æ—¥å¿—æ˜¯æœ€å¥½çš„è€å¸ˆ**ï¼šé€šè¿‡æ—¥å¿—å­¦ä¹ JDBCå·¥ä½œåŸç†  
- **æ€§èƒ½æ„è¯†å¾ˆé‡è¦**ï¼šä»å¼€å‘é˜¶æ®µå°±è¦å…³æ³¨SQLæ€§èƒ½
- **å·¥å…·ä½¿ç”¨è¦é€‚åº¦**ï¼šé€‰æ‹©é€‚åˆé¡¹ç›®çš„è°ƒè¯•å·¥å…·
- **ç›‘æ§æ˜¯é•¿æœŸå·¥ä½œ**ï¼šéœ€è¦æŒç»­å…³æ³¨å’Œä¼˜åŒ–