---
title: 4ã€å¸¸è§é”™è¯¯æ’æŸ¥æ‰‹å†Œ
---
## ğŸ“š ç›®å½•


1. [é©±åŠ¨åŠ è½½å¤±è´¥é—®é¢˜](#1-é©±åŠ¨åŠ è½½å¤±è´¥é—®é¢˜)
2. [æ•°æ®åº“è¿æ¥è¢«æ‹’ç»](#2-æ•°æ®åº“è¿æ¥è¢«æ‹’ç»)
3. [å­—ç¬¦ç¼–ç é”™ä¹±é—®é¢˜](#3-å­—ç¬¦ç¼–ç é”™ä¹±é—®é¢˜)
4. [æ—¶åŒºè®¾ç½®é”™è¯¯](#4-æ—¶åŒºè®¾ç½®é”™è¯¯)
5. [æ­»é”æ£€æµ‹ä¸å¤„ç†](#5-æ­»é”æ£€æµ‹ä¸å¤„ç†)
6. [è°ƒè¯•æŠ€å·§ä¸æœ€ä½³å®è·µ](#6-è°ƒè¯•æŠ€å·§ä¸æœ€ä½³å®è·µ)

---

# 1. ğŸš« é©±åŠ¨åŠ è½½å¤±è´¥é—®é¢˜



## 1.1 ä»€ä¹ˆæ˜¯é©±åŠ¨åŠ è½½å¤±è´¥



> **ğŸ’¡ é€šä¿—ç†è§£**
> å°±åƒä½ è¦å¼€è½¦ï¼Œå¿…é¡»å…ˆæœ‰é©¾ç…§æ‰èƒ½ä¸Šè·¯ã€‚JDBCé©±åŠ¨å°±æ˜¯Javaè¿æ¥æ•°æ®åº“çš„"é©¾ç…§"ï¼Œæ²¡æœ‰å®ƒå°±æ— æ³•ä¸æ•°æ®åº“"å¯¹è¯"ã€‚

**å¸¸è§é”™è¯¯ä¿¡æ¯ï¼š**
```
java.lang.ClassNotFoundException: com.mysql.cj.jdbc.Driver
java.sql.SQLException: No suitable driver found
```

## 1.2 é©±åŠ¨åŠ è½½å¤±è´¥çš„å¸¸è§åŸå› 



### ğŸ“‹ åŸå› åˆ†æè¡¨æ ¼


| é”™è¯¯ç±»å‹ | å…·ä½“åŸå›  | è§£å†³éš¾åº¦ | å½±å“ç¨‹åº¦ |
|---------|---------|----------|----------|
| **JARåŒ…ç¼ºå¤±** | `æ²¡æœ‰æ·»åŠ MySQLé©±åŠ¨åŒ…` | â­â˜†â˜† | ğŸ”´ ä¸¥é‡ |
| **è·¯å¾„é”™è¯¯** | `JARåŒ…è·¯å¾„é…ç½®ä¸æ­£ç¡®` | â­â­â˜† | ğŸ”´ ä¸¥é‡ |
| **ç‰ˆæœ¬ä¸åŒ¹é…** | `é©±åŠ¨ç‰ˆæœ¬ä¸MySQLç‰ˆæœ¬ä¸å…¼å®¹` | â­â­â­ | ğŸŸ¡ ä¸­ç­‰ |
| **ç±»åé”™è¯¯** | `é©±åŠ¨ç±»åå†™é”™äº†` | â­â˜†â˜† | ğŸ”´ ä¸¥é‡ |

### ğŸ”§ è§£å†³æ–¹æ¡ˆæ­¥éª¤



**æ­¥éª¤1ï¼šæ£€æŸ¥JARåŒ…æ˜¯å¦å­˜åœ¨**
```
é¡¹ç›®ç»“æ„æ£€æŸ¥ï¼š
MyProject/
â”œâ”€â”€ src/
â”œâ”€â”€ lib/           â† é©±åŠ¨JARåŒ…åº”è¯¥åœ¨è¿™é‡Œ
â”‚   â””â”€â”€ mysql-connector-java-8.0.33.jar
â””â”€â”€ WEB-INF/
    â””â”€â”€ lib/       â† æˆ–è€…åœ¨è¿™é‡Œ
```

**æ­¥éª¤2ï¼šæ­£ç¡®åŠ è½½é©±åŠ¨**
```java
// âœ… æ­£ç¡®çš„é©±åŠ¨åŠ è½½æ–¹å¼
try {
    // MySQL 8.0+ ä½¿ç”¨æ–°çš„é©±åŠ¨ç±»å
    Class.forName("com.mysql.cj.jdbc.Driver");
    System.out.println("é©±åŠ¨åŠ è½½æˆåŠŸï¼");
} catch (ClassNotFoundException e) {
    System.out.println("é©±åŠ¨åŠ è½½å¤±è´¥ï¼š" + e.getMessage());
}
```

> **âš ï¸ æ³¨æ„äº‹é¡¹**
> - MySQL 5.x ä½¿ç”¨ï¼š`com.mysql.jdbc.Driver`
> - MySQL 8.0+ ä½¿ç”¨ï¼š`com.mysql.cj.jdbc.Driver`
> - ä¸è¦ææ··äº†ç‰ˆæœ¬å¯¹åº”å…³ç³»

## 1.3 é©±åŠ¨ç‰ˆæœ¬å¯¹åº”å…³ç³»



**ğŸ“Š ç‰ˆæœ¬åŒ¹é…æŒ‡å—ï¼š**
```
MySQLç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQLç‰ˆæœ¬     â”‚        æ¨èé©±åŠ¨ç‰ˆæœ¬        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   5.0 - 5.7     â”‚   mysql-connector-java-5.x â”‚
â”‚   8.0 - 8.1     â”‚   mysql-connector-java-8.x â”‚
â”‚   8.2+          â”‚   mysql-connector-java-8.2+â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 2. ğŸ” æ•°æ®åº“è¿æ¥è¢«æ‹’ç»



## 2.1 è¿æ¥è¢«æ‹’ç»çš„å«ä¹‰



> **ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
> å°±åƒä½ å»æœ‹å‹å®¶åšå®¢ï¼Œæ•²é—¨åæœ‹å‹è¯´"ä¸è®¤è¯†ä½ ï¼Œä¸è®©è¿›"ã€‚æ•°æ®åº“è¿æ¥è¢«æ‹’ç»å°±æ˜¯è¿™ä¸ªæ„æ€ - æ•°æ®åº“ä¸è®©ä½ çš„ç¨‹åº"è¿›é—¨"ã€‚

**å…¸å‹é”™è¯¯ä¿¡æ¯ï¼š**
```
java.sql.SQLException: Access denied for user 'root'@'localhost'
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure
```

## 2.2 è¿æ¥è¢«æ‹’ç»çš„æ’æŸ¥æ­¥éª¤



### ğŸ” é—®é¢˜è¯Šæ–­æµç¨‹å›¾


```
è¿æ¥é—®é¢˜æ’æŸ¥æµç¨‹ï¼š
å¼€å§‹ â†’ æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å¯åŠ¨ â†’ æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡® â†’ æ£€æŸ¥ç”¨æˆ·åå¯†ç  â†’ æ£€æŸ¥è®¿é—®æƒé™ â†’ è§£å†³
  â”‚         â”‚                    â”‚                    â”‚                    â”‚
  â†“        âœ—                   âœ—                   âœ—                   âœ—
 å¤±è´¥    æœåŠ¡æœªå¯åŠ¨            ç«¯å£é”™è¯¯            è®¤è¯å¤±è´¥            æƒé™ä¸è¶³
```

### ğŸ“‹ æ’æŸ¥æ¸…å•



**ğŸ”¥ ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šåŸºç¡€è¿æ¥æ£€æŸ¥**
- [ ] **æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨**
  ```bash
#  # Windowsæ£€æŸ¥MySQLæœåŠ¡
  net start mysql
  
#  # Linuxæ£€æŸ¥MySQLçŠ¶æ€
  systemctl status mysql
  ```

- [ ] **ç«¯å£æ˜¯å¦æ­£ç¡®**
  ```java
  // é»˜è®¤MySQLç«¯å£æ˜¯3306
  String url = "jdbc:mysql://localhost:3306/test";
  ```

**ğŸŒŸ ç¬¬äºŒä¼˜å…ˆçº§ï¼šè®¤è¯ä¿¡æ¯æ£€æŸ¥**
- [ ] **ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®**
  ```java
  // æ£€æŸ¥è®¤è¯ä¿¡æ¯
  String username = "root";     // ç¡®è®¤ç”¨æˆ·å
  String password = "123456";   // ç¡®è®¤å¯†ç 
  ```

- [ ] **æ•°æ®åº“åç§°æ˜¯å¦å­˜åœ¨**
  ```sql
  -- åœ¨MySQLä¸­æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“
  SHOW DATABASES;
  ```

## 2.3 å¸¸è§è¿æ¥é”™è¯¯è§£å†³æ–¹æ¡ˆ



### ğŸ“Š é”™è¯¯ç å¯¹ç…§è¡¨


| é”™è¯¯ç  | é”™è¯¯å«ä¹‰ | è§£å†³æ–¹æ¡ˆ | ç´§æ€¥ç¨‹åº¦ |
|-------|---------|----------|----------|
| **1045** | `ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯` | é‡ç½®å¯†ç æˆ–æ£€æŸ¥è®¤è¯ä¿¡æ¯ | ğŸ”´ é«˜ |
| **2003** | `æ— æ³•è¿æ¥åˆ°MySQLæœåŠ¡å™¨` | æ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œç½‘ç»œ | ğŸ”´ é«˜ |
| **1049** | `æ•°æ®åº“ä¸å­˜åœ¨` | åˆ›å»ºæ•°æ®åº“æˆ–ä¿®æ”¹è¿æ¥URL | ğŸŸ¡ ä¸­ |
| **1130** | `ä¸»æœºè®¿é—®è¢«æ‹’ç»` | ä¿®æ”¹ç”¨æˆ·è®¿é—®æƒé™ | ğŸŸ¡ ä¸­ |

### ğŸ› ï¸ å®ç”¨è§£å†³ä»£ç ç¤ºä¾‹



```java
public class ConnectionTester {
    public static void testConnection() {
        String url = "jdbc:mysql://localhost:3306/test?useSSL=false&serverTimezone=UTC";
        String username = "root";
        String password = "123456";
        
        try {
            Connection conn = DriverManager.getConnection(url, username, password);
            System.out.println("âœ… è¿æ¥æˆåŠŸï¼");
            conn.close();
        } catch (SQLException e) {
            System.out.println("âŒ è¿æ¥å¤±è´¥ï¼š" + e.getMessage());
            // æ ¹æ®é”™è¯¯ç ç»™å‡ºå…·ä½“å»ºè®®
            diagnoseProblem(e);
        }
    }
    
    private static void diagnoseProblem(SQLException e) {
        int errorCode = e.getErrorCode();
        switch(errorCode) {
            case 1045:
                System.out.println("ğŸ’¡ å»ºè®®ï¼šæ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®");
                break;
            case 2003:
                System.out.println("ğŸ’¡ å»ºè®®ï¼šæ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨");
                break;
            case 1049:
                System.out.println("ğŸ’¡ å»ºè®®ï¼šæ£€æŸ¥æ•°æ®åº“åç§°æ˜¯å¦æ­£ç¡®");
                break;
        }
    }
}
```

---

# 3. ğŸ”¤ å­—ç¬¦ç¼–ç é”™ä¹±é—®é¢˜



## 3.1 å­—ç¬¦ç¼–ç é—®é¢˜çš„è¡¨ç°



> **ğŸ’¡ å½¢è±¡æ¯”å–»**
> å­—ç¬¦ç¼–ç é—®é¢˜å°±åƒä¸¤ä¸ªäººç”¨ä¸åŒçš„"å¯†ç æœ¬"å¯¹è¯ - ä½ è¯´ä¸­æ–‡ï¼Œå¯¹æ–¹å¬æˆäº†ç«æ˜Ÿæ–‡ï¼Œå®Œå…¨å¯¹ä¸ä¸Šå·ã€‚

**å¸¸è§ç—‡çŠ¶ï¼š**
```
æ•°æ®åº“å­˜å‚¨ï¼šä½ å¥½ä¸–ç•Œ
ç¨‹åºè¯»å–ï¼š????
ç½‘é¡µæ˜¾ç¤ºï¼šÃ¤Â½ Ã¥Â¥Â½Ã¤Â¸Ã§
```

## 3.2 ç¼–ç é—®é¢˜çš„æˆå› åˆ†æ



### ğŸ¯ ç¼–ç ä¼ è¾“é“¾è·¯å›¾


```
æ•°æ®ç¼–ç ä¼ è¾“é“¾è·¯ï¼š
Javaç¨‹åº â†’ JDBCé©±åŠ¨ â†’ MySQLæœåŠ¡å™¨ â†’ æ•°æ®è¡¨ â†’ ç£ç›˜å­˜å‚¨
   â†“          â†“          â†“           â†“         â†“
 UTF-8    connection   server     table    file
ç¼–ç è®¾ç½®   è¿æ¥ç¼–ç     æœåŠ¡å™¨ç¼–ç   è¡¨ç¼–ç    æ–‡ä»¶ç¼–ç 

ä»»ä½•ä¸€ç¯ç¼–ç ä¸ä¸€è‡´éƒ½ä¼šå¯¼è‡´ä¹±ç ï¼
```

## 3.3 ç¼–ç é—®é¢˜è§£å†³æ–¹æ¡ˆ



### ğŸ”§ å®Œæ•´è§£å†³æ­¥éª¤



**æ­¥éª¤1ï¼šè®¾ç½®è¿æ¥URLç¼–ç å‚æ•°**
```java
String url = "jdbc:mysql://localhost:3306/test" +
            "?useUnicode=true" +           // å¯ç”¨Unicodeæ”¯æŒ
            "&characterEncoding=utf8" +    // è®¾ç½®å­—ç¬¦ç¼–ç 
            "&useSSL=false";
```

**æ­¥éª¤2ï¼šæ£€æŸ¥MySQLæœåŠ¡å™¨ç¼–ç è®¾ç½®**
```sql
-- æŸ¥çœ‹MySQLå­—ç¬¦é›†è®¾ç½®
SHOW VARIABLES LIKE 'character%';
SHOW VARIABLES LIKE 'collation%';

-- è®¾ç½®æ•°æ®åº“å­—ç¬¦é›†
ALTER DATABASE test CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

**æ­¥éª¤3ï¼šJavaç¨‹åºç¼–ç å¤„ç†**
```java
public class EncodingHandler {
    public static void insertChineseData() throws SQLException {
        String url = "jdbc:mysql://localhost:3306/test?characterEncoding=utf8mb4";
        Connection conn = DriverManager.getConnection(url, "root", "password");
        
        // ç¡®ä¿è¿æ¥ä½¿ç”¨æ­£ç¡®ç¼–ç 
        PreparedStatement pstmt = conn.prepareStatement(
            "INSERT INTO users (name) VALUES (?)"
        );
        
        pstmt.setString(1, "å¼ ä¸‰æå››");  // ä¸­æ–‡æ•°æ®
        int result = pstmt.executeUpdate();
        
        System.out.println("æ’å…¥æˆåŠŸï¼Œå½±å“è¡Œæ•°ï¼š" + result);
        conn.close();
    }
}
```

> **ğŸ“Œ é‡è¦æç¤º**
> ä»MySQL 8.0å¼€å§‹ï¼Œæ¨èä½¿ç”¨ `utf8mb4` è€Œä¸æ˜¯ `utf8`ï¼Œå› ä¸ºå®ƒæ”¯æŒå®Œæ•´çš„4å­—èŠ‚Unicodeå­—ç¬¦ï¼ˆåŒ…æ‹¬emojiè¡¨æƒ…ï¼‰ã€‚

### ğŸ“‹ ç¼–ç è®¾ç½®æ£€æŸ¥æ¸…å•


- [ ] JDBCè¿æ¥URLåŒ…å«ç¼–ç å‚æ•°
- [ ] MySQLæœåŠ¡å™¨å­—ç¬¦é›†è®¾ç½®æ­£ç¡®  
- [ ] æ•°æ®åº“å­—ç¬¦é›†è®¾ç½®æ­£ç¡®
- [ ] æ•°æ®è¡¨å­—ç¬¦é›†è®¾ç½®æ­£ç¡®
- [ ] Javaç¨‹åºæ–‡ä»¶ä¿å­˜ä¸ºUTF-8ç¼–ç 

---

# 4. â° æ—¶åŒºè®¾ç½®é”™è¯¯



## 4.1 æ—¶åŒºé—®é¢˜çš„è¡¨ç°



> **ğŸ’¡ ç”Ÿæ´»å®ä¾‹**
> æ—¶åŒºé—®é¢˜å°±åƒä½ åœ¨åŒ—äº¬è¯´"ç°åœ¨æ˜¯ä¸‹åˆ3ç‚¹"ï¼Œä½†ç¾å›½æœ‹å‹ç†è§£æˆäº†ä»–ä»¬å½“åœ°çš„ä¸‹åˆ3ç‚¹ - æ—¶é—´å¯¹ä¸ä¸Šï¼Œå°±ä¹±å¥—äº†ã€‚

**å…¸å‹é”™è¯¯ä¿¡æ¯ï¼š**
```
java.sql.SQLException: The server time zone value is unrecognized
SQLException: Cannot create PoolableConnectionFactory
```

## 4.2 æ—¶åŒºé—®é¢˜çš„æ ¹æœ¬åŸå› 



### ğŸŒ æ—¶åŒºæ¦‚å¿µå›¾è§£


```
å…¨çƒæ—¶åŒºç¤ºæ„ï¼š
UTC-8        UTC+0        UTC+8
 ç¾å›½è¥¿æµ·å²¸    ä¼¦æ•¦æ ¼æ—å¨æ²»   ä¸­å›½åŒ—äº¬
    |          |            |
   å¤ªå¹³æ´‹æ—¶é—´   åè°ƒä¸–ç•Œæ—¶é—´   åŒ—äº¬æ—¶é—´
    
Javaç¨‹åºæ—¶åŒº â‰  MySQLæœåŠ¡å™¨æ—¶åŒº = æ—¶é—´æ··ä¹±
```

## 4.3 æ—¶åŒºé—®é¢˜è§£å†³æ–¹æ¡ˆ



### ğŸ”§ è§£å†³æ–¹æ¡ˆå¯¹æ¯”


| è§£å†³æ–¹å¼ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ¨èç¨‹åº¦ |
|---------|------|------|----------|
| **è¿æ¥URLæŒ‡å®šæ—¶åŒº** | `ç®€å•ç›´æ¥` | æ¯ä¸ªè¿æ¥éƒ½è¦è®¾ç½® | â­â­â­â­â­ |
| **MySQLæœåŠ¡å™¨è®¾ç½®æ—¶åŒº** | `ä¸€æ¬¡è®¾ç½®å…¨å±€ç”Ÿæ•ˆ` | éœ€è¦ç®¡ç†å‘˜æƒé™ | â­â­â­â­â˜† |
| **Javaç¨‹åºè®¾ç½®æ—¶åŒº** | `ç¨‹åºçº§åˆ«æ§åˆ¶` | å¯èƒ½å½±å“å…¶ä»–åŠŸèƒ½ | â­â­â­â˜†â˜† |

### ğŸ¯ æ¨èè§£å†³æ–¹æ¡ˆ



**æ–¹æ¡ˆ1ï¼šè¿æ¥URLè®¾ç½®æ—¶åŒºï¼ˆæ¨èï¼‰**
```java
// æ˜ç¡®æŒ‡å®šæ—¶åŒºï¼Œé¿å…è‡ªåŠ¨æ£€æµ‹é—®é¢˜
String url = "jdbc:mysql://localhost:3306/test" +
            "?serverTimezone=Asia/Shanghai" +     // è®¾ç½®ä¸ºä¸­å›½æ—¶åŒº
            "&useUnicode=true" +
            "&characterEncoding=utf8";

// æˆ–è€…ä½¿ç”¨UTCæ ‡å‡†æ—¶åŒºï¼ˆæ¨èç”¨äºå›½é™…é¡¹ç›®ï¼‰
String urlUTC = "jdbc:mysql://localhost:3306/test" +
               "?serverTimezone=UTC" +
               "&useUnicode=true";
```

**æ–¹æ¡ˆ2ï¼šMySQLæœåŠ¡å™¨æ—¶åŒºè®¾ç½®**
```sql
-- æŸ¥çœ‹å½“å‰æ—¶åŒºè®¾ç½®
SELECT $$global.time_zone, $$session.time_zone;

-- è®¾ç½®å…¨å±€æ—¶åŒº
SET GLOBAL time_zone = '+8:00';  -- åŒ—äº¬æ—¶é—´
SET SESSION time_zone = '+8:00'; -- å½“å‰ä¼šè¯æ—¶é—´
```

### ğŸ’» æ—¶åŒºå¤„ç†å·¥å…·ç±»


```java
public class TimeZoneHelper {
    public static Connection getConnectionWithTimezone() throws SQLException {
        String url = "jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai";
        return DriverManager.getConnection(url, "root", "password");
    }
    
    public static void testTimeZone() throws SQLException {
        Connection conn = getConnectionWithTimezone();
        Statement stmt = conn.createStatement();
        
        // æµ‹è¯•æ—¶é—´æ’å…¥å’ŒæŸ¥è¯¢
        stmt.execute("DROP TABLE IF EXISTS time_test");
        stmt.execute("CREATE TABLE time_test (id INT, create_time DATETIME)");
        
        // æ’å…¥å½“å‰æ—¶é—´
        stmt.execute("INSERT INTO time_test VALUES (1, NOW())");
        
        // æŸ¥è¯¢æ—¶é—´
        ResultSet rs = stmt.executeQuery("SELECT create_time FROM time_test");
        if (rs.next()) {
            System.out.println("æ•°æ®åº“æ—¶é—´ï¼š" + rs.getTimestamp("create_time"));
            System.out.println("Javaå½“å‰æ—¶é—´ï¼š" + new Date());
        }
        
        conn.close();
    }
}
```

---

# 5. âš ï¸ æ­»é”æ£€æµ‹ä¸å¤„ç†



## 5.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“æ­»é”



> **ğŸ’¡ é€šä¿—æ¯”å–»**
> æ­»é”å°±åƒä¸¤ä¸ªäººè¿‡ç‹¬æœ¨æ¡¥ï¼Œéƒ½ä¸è‚¯è®©è·¯ï¼Œç»“æœè°ä¹Ÿè¿‡ä¸å»ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œå°±æ˜¯ä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œæœ€ç»ˆéƒ½å¡ä½äº†ã€‚

**æ­»é”åœºæ™¯ç¤ºæ„ï¼š**
```
äº‹åŠ¡1æŒæœ‰èµ„æºAï¼Œç­‰å¾…èµ„æºB
äº‹åŠ¡2æŒæœ‰èµ„æºBï¼Œç­‰å¾…èµ„æºA
    â†“
ä¸¤ä¸ªäº‹åŠ¡æ°¸è¿œç­‰å¾…ä¸‹å» = æ­»é”
```

## 5.2 æ­»é”çš„å…¸å‹åœºæ™¯



### ğŸ“Š å¸¸è§æ­»é”ç±»å‹


| æ­»é”ç±»å‹ | äº§ç”ŸåŸå›  | å‘ç”Ÿé¢‘ç‡ | è§£å†³éš¾åº¦ |
|---------|---------|----------|----------|
| **è¡¨é”æ­»é”** | `å¤šä¸ªäº‹åŠ¡é”å®šä¸åŒè¡¨çš„é¡ºåºä¸ä¸€è‡´` | ğŸŸ¡ ä¸­ç­‰ | â­â­â˜† |
| **è¡Œé”æ­»é”** | `äº‹åŠ¡å¹¶å‘ä¿®æ”¹ç›¸åŒæ•°æ®è¡Œ` | ğŸ”´ é¢‘ç¹ | â­â­â­ |
| **é—´éš™é”æ­»é”** | `äº‹åŠ¡é”å®šæ•°æ®èŒƒå›´é‡å ` | ğŸŸ¢ è¾ƒå°‘ | â­â­â­â­ |

### ğŸ¯ æ­»é”äº§ç”Ÿç¤ºä¾‹



**åœºæ™¯ï¼šè½¬è´¦æ“ä½œæ­»é”**
```java
// äº‹åŠ¡1ï¼šä»è´¦æˆ·Aè½¬è´¦ç»™è´¦æˆ·B
public void transfer1() throws SQLException {
    Connection conn = getConnection();
    conn.setAutoCommit(false);  // å¼€å¯äº‹åŠ¡
    
    try {
        // 1. é”å®šè´¦æˆ·A
        PreparedStatement pstmt1 = conn.prepareStatement(
            "UPDATE accounts SET balance = balance - 100 WHERE id = 1");
        pstmt1.executeUpdate();
        
        Thread.sleep(1000);  // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
        
        // 2. é”å®šè´¦æˆ·B
        PreparedStatement pstmt2 = conn.prepareStatement(
            "UPDATE accounts SET balance = balance + 100 WHERE id = 2");
        pstmt2.executeUpdate();
        
        conn.commit();
    } catch (Exception e) {
        conn.rollback();
        throw e;
    }
}

// äº‹åŠ¡2ï¼šä»è´¦æˆ·Bè½¬è´¦ç»™è´¦æˆ·Aï¼ˆç›¸åé¡ºåºï¼Œå¯èƒ½æ­»é”ï¼‰
public void transfer2() throws SQLException {
    Connection conn = getConnection();
    conn.setAutoCommit(false);
    
    try {
        // 1. é”å®šè´¦æˆ·B
        PreparedStatement pstmt1 = conn.prepareStatement(
            "UPDATE accounts SET balance = balance - 50 WHERE id = 2");
        pstmt1.executeUpdate();
        
        Thread.sleep(1000);  // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
        
        // 2. é”å®šè´¦æˆ·Aï¼ˆç­‰å¾…äº‹åŠ¡1é‡Šæ”¾ï¼‰
        PreparedStatement pstmt2 = conn.prepareStatement(
            "UPDATE accounts SET balance = balance + 50 WHERE id = 1");
        pstmt2.executeUpdate();
        
        conn.commit();
    } catch (Exception e) {
        conn.rollback();
        throw e;
    }
}
```

## 5.3 æ­»é”æ£€æµ‹ä¸å¤„ç†ç­–ç•¥



### ğŸ” æ­»é”æ£€æµ‹æ–¹æ³•



**æ–¹æ³•1ï¼šæŸ¥çœ‹æ­»é”ä¿¡æ¯**
```sql
-- æŸ¥çœ‹å½“å‰äº‹åŠ¡çŠ¶æ€
SELECT * FROM information_schema.INNODB_TRX;

-- æŸ¥çœ‹é”ç­‰å¾…æƒ…å†µ
SELECT * FROM information_schema.INNODB_LOCK_WAITS;

-- æŸ¥çœ‹æœ€è¿‘çš„æ­»é”ä¿¡æ¯
SHOW ENGINE INNODB STATUS;
```

### ğŸ› ï¸ æ­»é”å¤„ç†ä»£ç å®ç°



```java
public class DeadlockHandler {
    private static final int MAX_RETRY_COUNT = 3;
    
    public boolean transferWithRetry(int fromAccount, int toAccount, double amount) {
        int retryCount = 0;
        
        while (retryCount < MAX_RETRY_COUNT) {
            try {
                transfer(fromAccount, toAccount, amount);
                return true;  // æˆåŠŸå®Œæˆ
                
            } catch (SQLException e) {
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ­»é”é”™è¯¯
                if (isDeadlockException(e)) {
                    retryCount++;
                    System.out.println("æ£€æµ‹åˆ°æ­»é”ï¼Œç¬¬" + retryCount + "æ¬¡é‡è¯•...");
                    
                    // éšæœºç­‰å¾…é¿å…é‡å¤æ­»é”
                    try {
                        Thread.sleep((long)(Math.random() * 1000));
                    } catch (InterruptedException ie) {
                        Thread.currentThread().interrupt();
                        break;
                    }
                } else {
                    throw new RuntimeException("éæ­»é”å¼‚å¸¸", e);
                }
            }
        }
        
        System.out.println("âŒ è½¬è´¦å¤±è´¥ï¼šè¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°");
        return false;
    }
    
    private boolean isDeadlockException(SQLException e) {
        // MySQLæ­»é”é”™è¯¯ç æ˜¯1213
        return e.getErrorCode() == 1213 || 
               e.getMessage().contains("Deadlock found");
    }
    
    // ä¼˜åŒ–åçš„è½¬è´¦æ–¹æ³•ï¼šæŒ‰IDé¡ºåºè·å–é”é¿å…æ­»é”
    public void transfer(int fromAccount, int toAccount, double amount) 
           throws SQLException {
        Connection conn = getConnection();
        conn.setAutoCommit(false);
        
        try {
            // ğŸ”‘ å…³é”®ä¼˜åŒ–ï¼šæŒ‰è´¦æˆ·IDé¡ºåºè·å–é”
            int firstId = Math.min(fromAccount, toAccount);
            int secondId = Math.max(fromAccount, toAccount);
            
            // å…ˆé”å®šIDè¾ƒå°çš„è´¦æˆ·
            lockAccount(conn, firstId);
            // å†é”å®šIDè¾ƒå¤§çš„è´¦æˆ·
            lockAccount(conn, secondId);
            
            // æ‰§è¡Œè½¬è´¦é€»è¾‘
            updateBalance(conn, fromAccount, -amount);
            updateBalance(conn, toAccount, amount);
            
            conn.commit();
            System.out.println("âœ… è½¬è´¦æˆåŠŸ");
            
        } catch (SQLException e) {
            conn.rollback();
            throw e;
        } finally {
            conn.close();
        }
    }
    
    private void lockAccount(Connection conn, int accountId) throws SQLException {
        PreparedStatement pstmt = conn.prepareStatement(
            "SELECT id FROM accounts WHERE id = ? FOR UPDATE");
        pstmt.setInt(1, accountId);
        pstmt.executeQuery();
    }
}
```

### ğŸ“‹ æ­»é”é¢„é˜²æœ€ä½³å®è·µ



> **ğŸ¯ æ­»é”é¢„é˜²åŸåˆ™**
> 1. **ç»Ÿä¸€é”é¡ºåº**ï¼šæ‰€æœ‰äº‹åŠ¡æŒ‰ç›¸åŒé¡ºåºè·å–é”
> 2. **ç¼©çŸ­äº‹åŠ¡æ—¶é—´**ï¼šå‡å°‘é”æŒæœ‰æ—¶é—´
> 3. **é™ä½éš”ç¦»çº§åˆ«**ï¼šåœ¨å¯æ¥å—èŒƒå›´å†…ä½¿ç”¨è¾ƒä½éš”ç¦»çº§åˆ«
> 4. **æ·»åŠ é‡è¯•æœºåˆ¶**ï¼šè‡ªåŠ¨å¤„ç†æ­»é”å¼‚å¸¸

---

# 6. ğŸ”§ è°ƒè¯•æŠ€å·§ä¸æœ€ä½³å®è·µ



## 6.1 JDBCè°ƒè¯•å·¥å…·ç®±



### ğŸ› ï¸ è°ƒè¯•å·¥å…·å¯¹æ¯”


| è°ƒè¯•å·¥å…· | åŠŸèƒ½ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | å­¦ä¹ æˆæœ¬ |
|---------|---------|----------|----------|
| **æ—¥å¿—è¾“å‡º** | `ç®€å•ç›´æ¥ï¼Œå®¹æ˜“å®ç°` | å¼€å‘è°ƒè¯• | â­â˜†â˜† |
| **IDEè°ƒè¯•å™¨** | `æ–­ç‚¹è°ƒè¯•ï¼Œå˜é‡æŸ¥çœ‹` | å¤æ‚é€»è¾‘è°ƒè¯• | â­â­â˜† |
| **MySQLå®¢æˆ·ç«¯** | `ç›´æ¥æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€` | æ•°æ®éªŒè¯ | â­â­â˜† |
| **æ€§èƒ½åˆ†æå·¥å…·** | `ä¸“ä¸šæ€§èƒ½åˆ†æ` | æ€§èƒ½ä¼˜åŒ– | â­â­â­â­ |

### ğŸ’» å®ç”¨è°ƒè¯•ä»£ç æ¨¡æ¿



```java
public class JDBCDebugHelper {
    private static final Logger logger = LoggerFactory.getLogger(JDBCDebugHelper.class);
    
    public static Connection getDebugConnection() throws SQLException {
        String url = "jdbc:mysql://localhost:3306/test" +
                    "?useUnicode=true&characterEncoding=utf8" +
                    "&serverTimezone=Asia/Shanghai" +
                    "&useSSL=false" +
                    "&profileSQL=true";  // å¯ç”¨SQLæ€§èƒ½åˆ†æ
        
        Connection conn = DriverManager.getConnection(url, "root", "password");
        
        // æ‰“å°è¿æ¥ä¿¡æ¯
        DatabaseMetaData metaData = conn.getMetaData();
        logger.info("æ•°æ®åº“è¿æ¥ä¿¡æ¯:");
        logger.info("- æ•°æ®åº“äº§å“: {}", metaData.getDatabaseProductName());
        logger.info("- æ•°æ®åº“ç‰ˆæœ¬: {}", metaData.getDatabaseProductVersion());
        logger.info("- é©±åŠ¨ç‰ˆæœ¬: {}", metaData.getDriverVersion());
        
        return conn;
    }
    
    public static void executeWithLog(String sql, Object... params) {
        try (Connection conn = getDebugConnection();
             PreparedStatement pstmt = conn.prepareStatement(sql)) {
            
            // è®°å½•SQLæ‰§è¡Œå‰ä¿¡æ¯
            logger.info("æ‰§è¡ŒSQL: {}", sql);
            logger.info("å‚æ•°: {}", Arrays.toString(params));
            
            // è®¾ç½®å‚æ•°
            for (int i = 0; i < params.length; i++) {
                pstmt.setObject(i + 1, params[i]);
            }
            
            // è®°å½•æ‰§è¡Œæ—¶é—´
            long startTime = System.currentTimeMillis();
            
            if (sql.trim().toUpperCase().startsWith("SELECT")) {
                ResultSet rs = pstmt.executeQuery();
                logResultSet(rs);
            } else {
                int updateCount = pstmt.executeUpdate();
                logger.info("å½±å“è¡Œæ•°: {}", updateCount);
            }
            
            long endTime = System.currentTimeMillis();
            logger.info("æ‰§è¡Œè€—æ—¶: {}ms", (endTime - startTime));
            
        } catch (SQLException e) {
            logger.error("SQLæ‰§è¡Œå¼‚å¸¸: {}", e.getMessage());
            logger.error("é”™è¯¯ç : {}", e.getErrorCode());
            logger.error("SQLçŠ¶æ€: {}", e.getSQLState());
        }
    }
    
    private static void logResultSet(ResultSet rs) throws SQLException {
        ResultSetMetaData metaData = rs.getMetaData();
        int columnCount = metaData.getColumnCount();
        
        // æ‰“å°è¡¨å¤´
        StringBuilder header = new StringBuilder("æŸ¥è¯¢ç»“æœ: ");
        for (int i = 1; i <= columnCount; i++) {
            header.append(metaData.getColumnName(i)).append("\t");
        }
        logger.info(header.toString());
        
        // æ‰“å°æ•°æ®ï¼ˆæœ€å¤šæ˜¾ç¤º10è¡Œï¼‰
        int rowCount = 0;
        while (rs.next() && rowCount < 10) {
            StringBuilder row = new StringBuilder("ç¬¬" + (++rowCount) + "è¡Œ: ");
            for (int i = 1; i <= columnCount; i++) {
                row.append(rs.getObject(i)).append("\t");
            }
            logger.info(row.toString());
        }
        
        if (rs.next()) {
            logger.info("... è¿˜æœ‰æ›´å¤šè¡Œæ•°æ®");
        }
    }
}
```

## 6.2 æ€§èƒ½ä¼˜åŒ–è°ƒè¯•



### ğŸ“Š æ€§èƒ½é—®é¢˜è¯Šæ–­æ¸…å•



```
æ€§èƒ½é—®é¢˜æ’æŸ¥æ­¥éª¤ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ                â”‚
â”‚ 2. æ‰§è¡Œè®¡åˆ’æŸ¥çœ‹(EXPLAIN)          â”‚
â”‚ 3. ç´¢å¼•ä½¿ç”¨æƒ…å†µæ£€æŸ¥               â”‚
â”‚ 4. è¿æ¥æ± é…ç½®ä¼˜åŒ–                â”‚
â”‚ 5. æ‰¹é‡æ“ä½œä¼˜åŒ–                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ…¢æŸ¥è¯¢æ£€æµ‹å·¥å…·ï¼š**
```java
public class PerformanceMonitor {
    private static final long SLOW_QUERY_THRESHOLD = 1000; // 1ç§’é˜ˆå€¼
    
    public static void monitorQuery(String sql, Runnable queryTask) {
        long startTime = System.currentTimeMillis();
        
        try {
            queryTask.run();
        } finally {
            long duration = System.currentTimeMillis() - startTime;
            
            if (duration > SLOW_QUERY_THRESHOLD) {
                System.out.println("âš ï¸ æ…¢æŸ¥è¯¢è­¦å‘Š:");
                System.out.println("SQL: " + sql);
                System.out.println("è€—æ—¶: " + duration + "ms");
                System.out.println("å»ºè®®: æ£€æŸ¥ç´¢å¼•æˆ–ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶");
            }
        }
    }
}
```

## 6.3 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ



> **ğŸ“‹ å¼‚å¸¸å¤„ç†ä¸‰åŸåˆ™**
> 1. **è®°å½•è¯¦ç»†ä¿¡æ¯**ï¼šè®°å½•å¼‚å¸¸å‘ç”Ÿçš„ä¸Šä¸‹æ–‡
> 2. **ä¼˜é›…é™çº§**ï¼šæä¾›å¤‡ç”¨æ–¹æ¡ˆ
> 3. **ç”¨æˆ·å‹å¥½**ï¼šç»™ç”¨æˆ·æ˜ç¡®çš„æç¤ºä¿¡æ¯

### ğŸ¯ å®Œæ•´å¼‚å¸¸å¤„ç†ç¤ºä¾‹



```java
public class RobustJDBCHandler {
    public User findUserById(int userId) {
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement("SELECT * FROM users WHERE id = ?");
            pstmt.setInt(1, userId);
            rs = pstmt.executeQuery();
            
            if (rs.next()) {
                return new User(rs.getInt("id"), rs.getString("name"));
            }
            return null;
            
        } catch (SQLException e) {
            // è¯¦ç»†è®°å½•å¼‚å¸¸ä¿¡æ¯
            logger.error("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥ - ID: {}, é”™è¯¯: {}", userId, e.getMessage());
            logger.error("SQLçŠ¶æ€: {}, é”™è¯¯ç : {}", e.getSQLState(), e.getErrorCode());
            
            // æ ¹æ®ä¸åŒå¼‚å¸¸ç±»å‹ç»™å‡ºä¸åŒå¤„ç†
            if (e.getErrorCode() == 2003) {
                throw new DatabaseConnectionException("æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
            } else if (e.getErrorCode() == 1146) {
                throw new DataException("ç”¨æˆ·è¡¨ä¸å­˜åœ¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
            } else {
                throw new SystemException("ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒ");
            }
            
        } finally {
            // ç¡®ä¿èµ„æºè¢«æ­£ç¡®å…³é—­
            closeResources(rs, pstmt, conn);
        }
    }
    
    private void closeResources(ResultSet rs, PreparedStatement pstmt, Connection conn) {
        try {
            if (rs != null) rs.close();
            if (pstmt != null) pstmt.close();
            if (conn != null) conn.close();
        } catch (SQLException e) {
            logger.warn("å…³é—­æ•°æ®åº“èµ„æºæ—¶å‡ºç°å¼‚å¸¸", e);
        }
    }
}
```

---

# ğŸ¯ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## ğŸ“‹ å¿…é¡»æŒæ¡çš„è°ƒè¯•æŠ€èƒ½



> **ğŸ”‘ å…³é”®è°ƒè¯•èƒ½åŠ›**
> - **å¿«é€Ÿå®šä½é—®é¢˜**ï¼šæ ¹æ®å¼‚å¸¸ä¿¡æ¯å¿«é€Ÿåˆ¤æ–­é—®é¢˜ç±»å‹
> - **ç³»ç»Ÿæ€§æ’æŸ¥**ï¼šæŒ‰ç…§æ¸…å•é€æ­¥æ’é™¤å¯èƒ½åŸå›   
> - **é¢„é˜²æ€§ç¼–ç¨‹**ï¼šå†™å‡ºå¥å£®çš„é”™è¯¯å¤„ç†ä»£ç 
> - **æ€§èƒ½æ„è¯†**ï¼šè¯†åˆ«å’Œä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ

## ğŸš€ è°ƒè¯•æ•ˆç‡æå‡æŠ€å·§



**ğŸ“Š é—®é¢˜è§£å†³æ•ˆç‡å¯¹æ¯”ï¼š**
| è°ƒè¯•æ–¹å¼ | è§£å†³é€Ÿåº¦ | å‡†ç¡®ç‡ | é€‚ç”¨èŒƒå›´ |
|---------|---------|--------|----------|
| **ç›²ç›®è¯•é”™** | ğŸŒ å¾ˆæ…¢ | ğŸ“‰ ä½ | ç®€å•é—®é¢˜ |
| **ç»éªŒçŒœæµ‹** | ğŸš— ä¸­ç­‰ | ğŸ“Š ä¸­ç­‰ | å¸¸è§é—®é¢˜ |
| **ç³»ç»Ÿæ’æŸ¥** | ğŸš€ å¿«é€Ÿ | ğŸ“ˆ é«˜ | æ‰€æœ‰é—®é¢˜ |

**ğŸª è®°å¿†å£è¯€ï¼š**
```
JDBCè°ƒè¯•äº”æ­¥æ³•ï¼š
çœ‹ - çœ‹å¼‚å¸¸ä¿¡æ¯å’Œé”™è¯¯ç 
æŸ¥ - æŸ¥é…ç½®å’Œè¿æ¥å‚æ•°  
æµ‹ - æµ‹è¯•ç½‘ç»œå’ŒæœåŠ¡çŠ¶æ€
æ”¹ - æ”¹æ­£é”™è¯¯é…ç½®
éªŒ - éªŒè¯ä¿®å¤æ•ˆæœ
```

## ğŸ’¡ å®æˆ˜ç»éªŒæ€»ç»“



**ğŸ”¥ æœ€å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼š**
1. **é©±åŠ¨ç‰ˆæœ¬ä¸åŒ¹é…** - æ–°æ‰‹æœ€å®¹æ˜“å¿½è§†
2. **å­—ç¬¦ç¼–ç è®¾ç½®** - ä¸­æ–‡é¡¹ç›®å¿…é‡é—®é¢˜
3. **æ—¶åŒºé…ç½®é”™è¯¯** - MySQL 8.0åçš„æ–°å‘
4. **è¿æ¥å‚æ•°é—æ¼** - ç»†èŠ‚å†³å®šæˆè´¥
5. **èµ„æºæœªæ­£ç¡®å…³é—­** - å†…å­˜æ³„éœ²çš„æ ¹æº

**âœ… é¢„é˜²é—®é¢˜çš„æœ€ä½³å®è·µï¼š**
- ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥
- ç»Ÿä¸€é…ç½®æ•°æ®åº“è¿æ¥å‚æ•°
- å»ºç«‹å®Œå–„çš„æ—¥å¿—è®°å½•æœºåˆ¶
- ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯æ•°æ®åº“æ“ä½œ
- å®šæœŸç›‘æ§æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡

> **ğŸ¯ æ ¸å¿ƒç†å¿µ**
> å¥½çš„JDBCç¼–ç¨‹ä¸ä»…è¦èƒ½å®ç°åŠŸèƒ½ï¼Œæ›´è¦èƒ½ä¼˜é›…åœ°å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µã€‚æŒæ¡è°ƒè¯•æŠ€å·§ï¼Œè®©ä½ çš„ä»£ç æ›´åŠ å¥å£®å¯é ï¼