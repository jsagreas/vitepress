---
title: 3ã€å¤§å¯¹è±¡LOBå¤„ç†
---
## ğŸ“š ç›®å½•

1. [LOBå¤§å¯¹è±¡åŸºæœ¬æ¦‚å¿µ](#1-LOBå¤§å¯¹è±¡åŸºæœ¬æ¦‚å¿µ)
2. [BLOBäºŒè¿›åˆ¶å¯¹è±¡å¤„ç†](#2-BLOBäºŒè¿›åˆ¶å¯¹è±¡å¤„ç†)
3. [CLOBæ–‡æœ¬å¯¹è±¡å¤„ç†](#3-CLOBæ–‡æœ¬å¯¹è±¡å¤„ç†)
4. [æµå¼è¯»å†™æ“ä½œ](#4-æµå¼è¯»å†™æ“ä½œ)
5. [å†…å­˜ä¼˜åŒ–ä¸æ€§èƒ½æ§åˆ¶](#5-å†…å­˜ä¼˜åŒ–ä¸æ€§èƒ½æ§åˆ¶)
6. [å®æˆ˜åº”ç”¨åœºæ™¯](#6-å®æˆ˜åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¦ LOBå¤§å¯¹è±¡åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯LOB


**ğŸ’¡ é€šä¿—ç†è§£**
æƒ³è±¡ä½ è¦åœ¨æ•°æ®åº“ä¸­å­˜å‚¨ä¸€å¼ ç…§ç‰‡æˆ–ä¸€ä»½é•¿ç¯‡å°è¯´ï¼Œæ™®é€šçš„æ•°æ®ç±»å‹è£…ä¸ä¸‹è¿™ä¹ˆå¤§çš„å†…å®¹ã€‚LOBå°±åƒæ˜¯æ•°æ®åº“ä¸“é—¨å‡†å¤‡çš„"å¤§ç®±å­"ï¼Œä¸“é—¨ç”¨æ¥è£…è¿™äº›ä½“ç§¯åºå¤§çš„æ•°æ®ã€‚

**ğŸ”¸ LOBçš„æ­£å¼å®šä¹‰**
```
LOB (Large Object) = å¤§å¯¹è±¡
â€¢ ä¸“é—¨å­˜å‚¨å¤§å®¹é‡æ•°æ®çš„æ•°æ®ç±»å‹
â€¢ å¯ä»¥å­˜å‚¨å…†å­—èŠ‚(MB)ç”šè‡³åƒå…†å­—èŠ‚(GB)çº§åˆ«çš„æ•°æ®
â€¢ æ˜¯æ•°æ®åº“å¯¹å¤§æ•°æ®å­˜å‚¨çš„è§£å†³æ–¹æ¡ˆ
```

### 1.2 LOBçš„ä¸¤å¤§å®¶æ—


**ğŸ”¸ BLOB vs CLOB å¯¹æ¯”**

```
ğŸ“„ æ–‡ä»¶å­˜å‚¨ç±»æ¯”ï¼š
BLOB = å­˜å‚¨ç…§ç‰‡ã€è§†é¢‘ã€éŸ³ä¹ç­‰äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–‡ä»¶å¤¹
CLOB = å­˜å‚¨æ–‡æ¡£ã€å°è¯´ã€ä»£ç ç­‰æ–‡æœ¬æ–‡ä»¶çš„æ–‡ä»¶å¤¹

æ•°æ®åº“ä¸­ï¼š
BLOB = Binary Large Object (äºŒè¿›åˆ¶å¤§å¯¹è±¡)
CLOB = Character Large Object (å­—ç¬¦å¤§å¯¹è±¡)
```

| ç‰¹å¾å¯¹æ¯” | **BLOB** | **CLOB** |
|---------|----------|----------|
| **å­˜å‚¨å†…å®¹** | `äºŒè¿›åˆ¶æ•°æ®(å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘)` | `æ–‡æœ¬æ•°æ®(æ–‡ç« ã€å°è¯´ã€ä»£ç )` |
| **æ•°æ®æ ¼å¼** | `å­—èŠ‚æµ(byte[])` | `å­—ç¬¦æµ(String)` |
| **å¸¸è§åº”ç”¨** | `å¤´åƒã€é™„ä»¶ã€åª’ä½“æ–‡ä»¶` | `åšå®¢æ–‡ç« ã€äº§å“æè¿°` |
| **è¯»å–æ–¹å¼** | `InputStream` | `Reader/String` |
| **æœ€å¤§å®¹é‡** | `é€šå¸¸4GBå·¦å³` | `é€šå¸¸4GBå·¦å³` |

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦LOB


**âŒ æ™®é€šå­—æ®µçš„å±€é™**
```
VARCHARç±»å‹é™åˆ¶ï¼š
â€¢ MySQL VARCHAR: æœ€å¤§65535å­—ç¬¦
â€¢ ä¸€å¼ é«˜æ¸…ç…§ç‰‡: é€šå¸¸2-10MB
â€¢ ç»“æœ: æ™®é€šå­—æ®µæ ¹æœ¬è£…ä¸ä¸‹ï¼

å®é™…éœ€æ±‚ï¼š
â€¢ ç”¨æˆ·å¤´åƒ (100KB-2MB)
â€¢ äº§å“è¯¦æƒ…æè¿° (å¯èƒ½å¾ˆé•¿çš„HTML)  
â€¢ æ–‡æ¡£é™„ä»¶ (Wordã€PDFæ–‡æ¡£)
â€¢ éŸ³è§†é¢‘æ–‡ä»¶ (å‡ MBåˆ°å‡ GB)
```

**âœ… LOBçš„ä¼˜åŠ¿**
```
å­˜å‚¨å®¹é‡å¤§ï¼š
â€¢ å¯ä»¥å­˜å‚¨GBçº§åˆ«çš„æ•°æ®
â€¢ çªç ´æ™®é€šå­—æ®µçš„å¤§å°é™åˆ¶

çµæ´»çš„è®¿é—®æ–¹å¼ï¼š
â€¢ æ”¯æŒæµå¼è¯»å–ï¼Œä¸å ç”¨å¤§é‡å†…å­˜
â€¢ å¯ä»¥åˆ†å—å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½
â€¢ æ”¯æŒéšæœºè®¿é—®ç‰¹å®šä½ç½®çš„æ•°æ®
```

---

## 2. ğŸ–¼ï¸ BLOBäºŒè¿›åˆ¶å¯¹è±¡å¤„ç†


### 2.1 BLOBçš„æœ¬è´¨ç†è§£


**ğŸ”¸ BLOBå°±åƒæ•°æ®åº“ä¸­çš„"ä¿é™©æŸœ"**
```
ç°å®æ¯”å–»ï¼š
ä¿é™©æŸœå­˜è´µé‡ç‰©å“ â†’ BLOBå­˜äºŒè¿›åˆ¶æ–‡ä»¶
â€¢ ä¿é™©æŸœæœ‰ç¼–å·ä½†ä¸çŸ¥é“é‡Œé¢å…·ä½“æ˜¯ä»€ä¹ˆ
â€¢ BLOBæœ‰å¼•ç”¨ä½†éœ€è¦æ‰“å¼€æ‰çŸ¥é“å†…å®¹
â€¢ éƒ½éœ€è¦ç‰¹æ®Šçš„æ–¹å¼æ¥å­˜å–

æŠ€æœ¯è§’åº¦ï¼š
BLOBåœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„æ˜¯ï¼š
1. å®é™…çš„äºŒè¿›åˆ¶æ•°æ®
2. æ•°æ®é•¿åº¦ä¿¡æ¯  
3. æ•°æ®åº“å†…éƒ¨çš„å¼•ç”¨æŒ‡é’ˆ
```

### 2.2 BLOBæ•°æ®çš„å­˜å‚¨æ“ä½œ


**ğŸ“ å­˜å‚¨å›¾ç‰‡åˆ°BLOBå­—æ®µ**

```java
// ğŸ’¡ å­˜å‚¨ç”¨æˆ·å¤´åƒçš„å®Œæ•´ç¤ºä¾‹
public class UserAvatarService {
    
    /**
     * ä¿å­˜ç”¨æˆ·å¤´åƒåˆ°æ•°æ®åº“
     * @param userId ç”¨æˆ·ID
     * @param imageFile å¤´åƒæ–‡ä»¶
     */
    public void saveUserAvatar(int userId, File imageFile) {
        String sql = "UPDATE users SET avatar = ? WHERE user_id = ?";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql);
             FileInputStream fis = new FileInputStream(imageFile)) {
            
            // ğŸ”‘ å…³é”®ç‚¹1: ä½¿ç”¨setBinaryStreamè®¾ç½®BLOBæ•°æ®
            ps.setBinaryStream(1, fis, imageFile.length());
            ps.setInt(2, userId);
            
            int result = ps.executeUpdate();
            if (result > 0) {
                System.out.println("å¤´åƒä¸Šä¼ æˆåŠŸï¼æ–‡ä»¶å¤§å°: " + imageFile.length() + " å­—èŠ‚");
            }
            
        } catch (Exception e) {
            System.err.println("å¤´åƒä¸Šä¼ å¤±è´¥: " + e.getMessage());
        }
    }
}
```

**ğŸ” ä»£ç è¯¦è§£**
```
setBinaryStreamæ–¹æ³•è¯´æ˜ï¼š
â€¢ å‚æ•°1: SQLä¸­çš„å ä½ç¬¦ä½ç½® (?)
â€¢ å‚æ•°2: è¾“å…¥æµ (FileInputStream)  
â€¢ å‚æ•°3: æ•°æ®é•¿åº¦ (å­—èŠ‚æ•°)

ä¸ºä»€ä¹ˆç”¨æµè€Œä¸æ˜¯ç›´æ¥ç”¨byte[]ï¼Ÿ
â€¢ æµå¼å¤„ç†: ä¸ä¼šä¸€æ¬¡æ€§æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜
â€¢ å†…å­˜å‹å¥½: å¤§æ–‡ä»¶ä¹Ÿä¸ä¼šå¯¼è‡´å†…å­˜æº¢å‡º
â€¢ æ€§èƒ½æ›´å¥½: æ•°æ®åº“å¯ä»¥è¾¹è¯»è¾¹å†™ï¼Œæ•ˆç‡é«˜
```

### 2.3 BLOBæ•°æ®çš„è¯»å–æ“ä½œ


**ğŸ“– ä»æ•°æ®åº“è¯»å–å›¾ç‰‡**

```java
/**
 * è·å–ç”¨æˆ·å¤´åƒå¹¶ä¿å­˜ä¸ºæ–‡ä»¶
 */
public void getUserAvatar(int userId, String outputPath) {
    String sql = "SELECT avatar FROM users WHERE user_id = ?";
    
    try (Connection conn = getConnection();
         PreparedStatement ps = conn.prepareStatement(sql)) {
        
        ps.setInt(1, userId);
        ResultSet rs = ps.executeQuery();
        
        if (rs.next()) {
            // ğŸ”‘ å…³é”®ç‚¹: è·å–BLOBå¯¹è±¡
            Blob blob = rs.getBlob("avatar");
            
            if (blob != null) {
                // ğŸ“ ä¿å­˜åˆ°æ–‡ä»¶
                saveBlob ToFile(blob, outputPath);
                System.out.println("å¤´åƒä¸‹è½½æˆåŠŸ: " + outputPath);
            } else {
                System.out.println("ç”¨æˆ·è¿˜æ²¡æœ‰è®¾ç½®å¤´åƒ");
            }
        }
        
    } catch (Exception e) {
        System.err.println("å¤´åƒä¸‹è½½å¤±è´¥: " + e.getMessage());
    }
}

/**
 * å°†BLOBæ•°æ®ä¿å­˜ä¸ºæ–‡ä»¶
 */
private void saveBlobToFile(Blob blob, String filePath) throws Exception {
    try (InputStream is = blob.getBinaryStream();
         FileOutputStream fos = new FileOutputStream(filePath)) {
        
        // ğŸš€ åˆ†å—è¯»å–ï¼Œé¿å…å†…å­˜æº¢å‡º
        byte[] buffer = new byte[8192]; // 8KBç¼“å†²åŒº
        int bytesRead;
        
        while ((bytesRead = is.read(buffer)) != -1) {
            fos.write(buffer, 0, bytesRead);
        }
    }
}
```

**ğŸ’¡ è¯»å–è¿‡ç¨‹è§£æ**
```
BLOBè¯»å–çš„ä¸‰ä¸ªæ­¥éª¤ï¼š
1ï¸âƒ£ rs.getBlob() â†’ è·å–BLOBå¯¹è±¡å¼•ç”¨
2ï¸âƒ£ blob.getBinaryStream() â†’ è·å–äºŒè¿›åˆ¶æµ
3ï¸âƒ£ æµå¼è¯»å– â†’ åˆ†å—å¤„ç†æ•°æ®

ä¸ºä»€ä¹ˆè¦åˆ†å—è¯»å–ï¼Ÿ
â€¢ å†…å­˜å®‰å…¨: å¤§æ–‡ä»¶ä¸ä¼šæ’‘çˆ†å†…å­˜
â€¢ å®æ—¶å¤„ç†: å¯ä»¥è¾¹è¯»è¾¹å†™  
â€¢ é”™è¯¯æ¢å¤: å‡ºé”™æ—¶åªå½±å“å½“å‰å—
```

---

## 3. ğŸ“ CLOBæ–‡æœ¬å¯¹è±¡å¤„ç†


### 3.1 CLOBçš„åº”ç”¨åœºæ™¯


**ğŸ”¸ CLOBå°±åƒ"æ•°å­—å›¾ä¹¦é¦†"**
```
ç°å®åœºæ™¯ â†’ æ•°æ®åº“åº”ç”¨
â€¢ å›¾ä¹¦é¦†å­˜å‚¨é•¿ç¯‡å°è¯´ â†’ CLOBå­˜å‚¨åšå®¢æ–‡ç« 
â€¢ æ¡£æ¡ˆé¦†å­˜å‚¨å†å²æ–‡æ¡£ â†’ CLOBå­˜å‚¨äº§å“è¯¦æƒ…  
â€¢ èµ„æ–™å®¤å­˜å‚¨æŠ€æœ¯æ‰‹å†Œ â†’ CLOBå­˜å‚¨å¸®åŠ©æ–‡æ¡£

å¸¸è§CLOBä½¿ç”¨åœºæ™¯ï¼š
ğŸ“° æ–°é—»æ–‡ç« å†…å®¹ (å‡ åƒåˆ°å‡ ä¸‡å­—)
ğŸ›’ å•†å“è¯¦ç»†æè¿° (åŒ…å«HTMLæ ¼å¼)
ğŸ“§ é‚®ä»¶æ­£æ–‡å†…å®¹ (å¯èƒ½å¾ˆé•¿)
ğŸ“‹ ç³»ç»Ÿæ—¥å¿—è®°å½• (è¯¦ç»†çš„æ“ä½œæ—¥å¿—)
```

### 3.2 CLOBæ•°æ®çš„å­˜å‚¨


**ğŸ“ å­˜å‚¨æ–‡ç« å†…å®¹ç¤ºä¾‹**

```java
public class ArticleService {
    
    /**
     * å‘å¸ƒæ–°æ–‡ç« 
     */
    public void publishArticle(String title, String content, int authorId) {
        String sql = "INSERT INTO articles (title, content, author_id, create_time) VALUES (?, ?, ?, NOW())";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setString(1, title);
            
            // ğŸ”‘ å…³é”®ç‚¹: ä½¿ç”¨setCharacterStreamå¤„ç†é•¿æ–‡æœ¬
            StringReader reader = new StringReader(content);
            ps.setCharacterStream(2, reader, content.length());
            
            ps.setInt(3, authorId);
            
            int result = ps.executeUpdate();
            if (result > 0) {
                System.out.println("æ–‡ç« å‘å¸ƒæˆåŠŸï¼å†…å®¹é•¿åº¦: " + content.length() + " å­—ç¬¦");
            }
            
        } catch (Exception e) {
            System.err.println("æ–‡ç« å‘å¸ƒå¤±è´¥: " + e.getMessage());
        }
    }
}
```

**ğŸ” CLOBå­˜å‚¨è¦ç‚¹**
```
setCharacterStream vs setString:
â€¢ setString: é€‚åˆçŸ­æ–‡æœ¬ï¼Œæœ‰é•¿åº¦é™åˆ¶
â€¢ setCharacterStream: é€‚åˆé•¿æ–‡æœ¬ï¼Œæ”¯æŒæµå¼å¤„ç†

StringReaderçš„ä½œç”¨:
â€¢ å°†Stringè½¬æ¢ä¸ºå­—ç¬¦æµ
â€¢ è®©æ•°æ®åº“å¯ä»¥æµå¼è¯»å–æ–‡æœ¬
â€¢ é¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§æ–‡æœ¬åˆ°å†…å­˜
```

### 3.3 CLOBæ•°æ®çš„è¯»å–


**ğŸ“– è¯»å–æ–‡ç« å†…å®¹**

```java
/**
 * è·å–æ–‡ç« è¯¦æƒ…
 */
public Article getArticleDetail(int articleId) {
    String sql = "SELECT title, content, author_id FROM articles WHERE article_id = ?";
    
    try (Connection conn = getConnection();
         PreparedStatement ps = conn.prepareStatement(sql)) {
        
        ps.setInt(1, articleId);
        ResultSet rs = ps.executeQuery();
        
        if (rs.next()) {
            Article article = new Article();
            article.setTitle(rs.getString("title"));
            article.setAuthorId(rs.getInt("author_id"));
            
            // ğŸ”‘ å¤„ç†CLOBå­—æ®µçš„ä¸¤ç§æ–¹å¼
            
            // æ–¹å¼1: ç›´æ¥è¯»å–ä¸ºString (é€‚åˆä¸å¤ªå¤§çš„æ–‡æœ¬)
            String content = rs.getString("content");
            article.setContent(content);
            
            // æ–¹å¼2: æµå¼è¯»å– (é€‚åˆå¾ˆå¤§çš„æ–‡æœ¬)  
            // Clob clob = rs.getClob("content");
            // String content = readClobToString(clob);
            
            return article;
        }
        
    } catch (Exception e) {
        System.err.println("è·å–æ–‡ç« å¤±è´¥: " + e.getMessage());
    }
    
    return null;
}

/**
 * æµå¼è¯»å–CLOBå†…å®¹ (å¤„ç†è¶…å¤§æ–‡æœ¬æ—¶ä½¿ç”¨)
 */
private String readClobToString(Clob clob) throws Exception {
    if (clob == null) return null;
    
    StringBuilder content = new StringBuilder();
    
    try (Reader reader = clob.getCharacterStream()) {
        char[] buffer = new char[4096]; // 4KBå­—ç¬¦ç¼“å†²åŒº
        int charsRead;
        
        while ((charsRead = reader.read(buffer)) != -1) {
            content.append(buffer, 0, charsRead);
        }
    }
    
    return content.toString();
}
```

---

## 4. ğŸ”„ æµå¼è¯»å†™æ“ä½œ


### 4.1 æµå¼å¤„ç†çš„æ ¸å¿ƒæ€æƒ³


**ğŸ’¡ æµå¼å¤„ç†å°±åƒ"æ°´ç®¡è¾“æ°´"**
```
ä¼ ç»Ÿæ–¹å¼ (ä¸€æ¬¡æ€§å¤„ç†):
ğŸª£ ç”¨æ°´æ¡¶æ¥æ°´ â†’ å†…å­˜ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
â€¢ ä¼˜ç‚¹: ç®€å•ç›´æ¥
â€¢ ç¼ºç‚¹: æ°´æ¡¶å®¹é‡æœ‰é™ï¼Œå¤§é‡æ•°æ®è£…ä¸ä¸‹

æµå¼å¤„ç†:
ğŸš¿ ç”¨æ°´ç®¡è¾“æ°´ â†’ æ•°æ®æµå¼ä¼ è¾“
â€¢ ä¼˜ç‚¹: ä¸é™åˆ¶æ•°æ®å¤§å°ï¼Œå†…å­˜å ç”¨ç¨³å®š
â€¢ ç¼ºç‚¹: éœ€è¦é¢å¤–çš„æµç®¡ç†ä»£ç 
```

### 4.2 InputStreamå¤„ç†BLOB


**ğŸ–¼ï¸ å¤§å›¾ç‰‡çš„åˆ†å—ä¸Šä¼ **

```java
public class LargeFileHandler {
    
    /**
     * ä¸Šä¼ å¤§æ–‡ä»¶ (è§†é¢‘ã€é«˜æ¸…å›¾ç‰‡ç­‰)
     */
    public void uploadLargeFile(File file, String fileType) {
        String sql = "INSERT INTO file_storage (file_name, file_data, file_type, file_size) VALUES (?, ?, ?, ?)";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql);
             FileInputStream fis = new FileInputStream(file)) {
            
            ps.setString(1, file.getName());
            ps.setString(3, fileType);
            ps.setLong(4, file.length());
            
            // ğŸš€ å…³é”®ç‚¹: æµå¼è®¾ç½®å¤§æ–‡ä»¶æ•°æ®
            ps.setBinaryStream(2, fis, file.length());
            
            System.out.println("å¼€å§‹ä¸Šä¼ æ–‡ä»¶: " + file.getName() + 
                             " (å¤§å°: " + formatFileSize(file.length()) + ")");
            
            int result = ps.executeUpdate();
            
            if (result > 0) {
                System.out.println("âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼");
            }
            
        } catch (Exception e) {
            System.err.println("âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥: " + e.getMessage());
        }
    }
    
    /**
     * ä¸‹è½½å¤§æ–‡ä»¶
     */
    public void downloadLargeFile(int fileId, String savePath) {
        String sql = "SELECT file_name, file_data, file_size FROM file_storage WHERE file_id = ?";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setInt(1, fileId);
            ResultSet rs = ps.executeQuery();
            
            if (rs.next()) {
                String fileName = rs.getString("file_name");
                long fileSize = rs.getLong("file_size");
                Blob blob = rs.getBlob("file_data");
                
                System.out.println("å¼€å§‹ä¸‹è½½æ–‡ä»¶: " + fileName + 
                                 " (å¤§å°: " + formatFileSize(fileSize) + ")");
                
                // ğŸ”„ åˆ†å—ä¸‹è½½ï¼Œæ˜¾ç¤ºè¿›åº¦
                downloadWithProgress(blob, savePath + "/" + fileName, fileSize);
            }
            
        } catch (Exception e) {
            System.err.println("æ–‡ä»¶ä¸‹è½½å¤±è´¥: " + e.getMessage());
        }
    }
    
    /**
     * å¸¦è¿›åº¦æ˜¾ç¤ºçš„ä¸‹è½½
     */
    private void downloadWithProgress(Blob blob, String filePath, long totalSize) throws Exception {
        try (InputStream is = blob.getBinaryStream();
             FileOutputStream fos = new FileOutputStream(filePath)) {
            
            byte[] buffer = new byte[8192]; // 8KBç¼“å†²åŒº
            long downloadedBytes = 0;
            int bytesRead;
            
            while ((bytesRead = is.read(buffer)) != -1) {
                fos.write(buffer, 0, bytesRead);
                downloadedBytes += bytesRead;
                
                // ğŸ¯ æ˜¾ç¤ºä¸‹è½½è¿›åº¦
                showProgress(downloadedBytes, totalSize);
            }
            
            System.out.println("\nâœ… ä¸‹è½½å®Œæˆ: " + filePath);
        }
    }
}
```

### 4.3 Readerå¤„ç†CLOB


**ğŸ“– å¤§æ–‡æ¡£çš„åˆ†å—è¯»å–**

```java
/**
 * å¤„ç†è¶…å¤§æ–‡æœ¬æ–‡æ¡£
 */
public class LargeTextProcessor {
    
    /**
     * é€è¡Œè¯»å–å¤§æ–‡æ¡£å†…å®¹
     */
    public void processLargeDocument(int docId) {
        String sql = "SELECT doc_title, doc_content FROM documents WHERE doc_id = ?";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setInt(1, docId);
            ResultSet rs = ps.executeQuery();
            
            if (rs.next()) {
                String title = rs.getString("doc_title");
                Clob clob = rs.getClob("doc_content");
                
                System.out.println("å¼€å§‹å¤„ç†æ–‡æ¡£: " + title);
                
                // ğŸ”„ æµå¼è¯»å–ï¼Œé€å—å¤„ç†
                processTextByChunks(clob);
            }
            
        } catch (Exception e) {
            System.err.println("æ–‡æ¡£å¤„ç†å¤±è´¥: " + e.getMessage());
        }
    }
    
    /**
     * åˆ†å—å¤„ç†æ–‡æœ¬å†…å®¹
     */
    private void processTextByChunks(Clob clob) throws Exception {
        try (Reader reader = clob.getCharacterStream();
             BufferedReader br = new BufferedReader(reader)) {
            
            String line;
            int lineCount = 0;
            int wordCount = 0;
            
            // ğŸ“ é€è¡Œè¯»å–å’Œç»Ÿè®¡
            while ((line = br.readLine()) != null) {
                lineCount++;
                wordCount += countWords(line);
                
                // æ¯å¤„ç†1000è¡Œæ˜¾ç¤ºä¸€æ¬¡è¿›åº¦
                if (lineCount % 1000 == 0) {
                    System.out.println("å·²å¤„ç† " + lineCount + " è¡Œ...");
                }
            }
            
            System.out.println("ğŸ“Š æ–‡æ¡£ç»Ÿè®¡å®Œæˆ:");
            System.out.println("  æ€»è¡Œæ•°: " + lineCount);
            System.out.println("  æ€»è¯æ•°: " + wordCount);
        }
    }
}
```

---

## 5. ğŸ’¾ å†…å­˜ä¼˜åŒ–ä¸æ€§èƒ½æ§åˆ¶


### 5.1 å†…å­˜å ç”¨æ§åˆ¶ç­–ç•¥


**ğŸ§  å†…å­˜ç®¡ç†çš„é‡è¦æ€§**

```
å†…å­˜é—®é¢˜å®ä¾‹:
âŒ é”™è¯¯åšæ³•: ä¸€æ¬¡æ€§åŠ è½½100MBçš„è§†é¢‘åˆ°å†…å­˜
   â†’ ç»“æœ: OutOfMemoryError ç¨‹åºå´©æºƒ

âœ… æ­£ç¡®åšæ³•: ä½¿ç”¨8KBç¼“å†²åŒºåˆ†å—å¤„ç†  
   â†’ ç»“æœ: å†…å­˜å ç”¨ç¨³å®šï¼Œå¤„ç†ä»»æ„å¤§å°æ–‡ä»¶
```

**ğŸ“Š å†…å­˜å ç”¨å¯¹æ¯”**

| å¤„ç†æ–¹å¼ | **å†…å­˜å ç”¨** | **é€‚ç”¨æ–‡ä»¶å¤§å°** | **é£é™©ç­‰çº§** |
|---------|-------------|----------------|-------------|
| `ç›´æ¥è¯»å–byte[]` | `ç­‰äºæ–‡ä»¶å¤§å°` | `< 10MB` | `ğŸ”´ é«˜é£é™©` |
| `8KBç¼“å†²åŒºæµå¼` | `å›ºå®š8KB` | `ä»»æ„å¤§å°` | `ğŸŸ¢ å®‰å…¨` |
| `64KBç¼“å†²åŒºæµå¼` | `å›ºå®š64KB` | `ä»»æ„å¤§å°` | `ğŸŸ¢ å®‰å…¨` |

### 5.2 ç¼“å†²åŒºå¤§å°ä¼˜åŒ–


**âš–ï¸ ç¼“å†²åŒºå¤§å°çš„é€‰æ‹©è‰ºæœ¯**

```java
public class BufferSizeOptimizer {
    
    // ğŸ¯ ä¸åŒåœºæ™¯çš„æœ€ä½³ç¼“å†²åŒºå¤§å°
    private static final int SMALL_BUFFER = 4096;   // 4KB - å°æ–‡ä»¶
    private static final int MEDIUM_BUFFER = 8192;  // 8KB - ä¸­ç­‰æ–‡ä»¶  
    private static final int LARGE_BUFFER = 65536;  // 64KB - å¤§æ–‡ä»¶
    
    /**
     * æ ¹æ®æ–‡ä»¶å¤§å°æ™ºèƒ½é€‰æ‹©ç¼“å†²åŒº
     */
    private int getOptimalBufferSize(long fileSize) {
        if (fileSize < 1024 * 1024) {          // < 1MB
            return SMALL_BUFFER;
        } else if (fileSize < 10 * 1024 * 1024) {  // < 10MB
            return MEDIUM_BUFFER;
        } else {                               // >= 10MB
            return LARGE_BUFFER;
        }
    }
    
    /**
     * æ™ºèƒ½æ–‡ä»¶å¤åˆ¶
     */
    public void smartFileCopy(Blob source, String targetPath, long fileSize) throws Exception {
        int bufferSize = getOptimalBufferSize(fileSize);
        
        try (InputStream is = source.getBinaryStream();
             FileOutputStream fos = new FileOutputStream(targetPath)) {
            
            byte[] buffer = new byte[bufferSize];
            int bytesRead;
            
            System.out.println("ä½¿ç”¨ " + bufferSize + " å­—èŠ‚ç¼“å†²åŒºå¤„ç†æ–‡ä»¶");
            
            while ((bytesRead = is.read(buffer)) != -1) {
                fos.write(buffer, 0, bytesRead);
            }
        }
    }
}
```

### 5.3 è¿æ¥èµ„æºç®¡ç†


**ğŸ”’ èµ„æºé‡Šæ”¾çš„é‡è¦æ€§**

```java
/**
 * âœ… æ ‡å‡†çš„èµ„æºç®¡ç†æ¨¡å¼
 */
public class ResourceManagement {
    
    public void processLOB_Correct() {
        // ğŸ¯ ä½¿ç”¨ try-with-resources è‡ªåŠ¨ç®¡ç†èµ„æº
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement("SELECT data FROM files WHERE id=1");
             ResultSet rs = ps.executeQuery()) {
            
            if (rs.next()) {
                Blob blob = rs.getBlob("data");
                
                // ğŸ”„ å†…å±‚èµ„æºä¹Ÿè¦æ­£ç¡®ç®¡ç†
                try (InputStream is = blob.getBinaryStream()) {
                    // å¤„ç†æ•°æ®...
                    processStream(is);
                }
                // InputStream ä¼šè‡ªåŠ¨å…³é—­
            }
            
        } catch (Exception e) {
            e.printStackTrace();
        }
        // Connection, PreparedStatement, ResultSet ä¼šè‡ªåŠ¨å…³é—­
    }
    
    /**
     * âŒ é”™è¯¯çš„èµ„æºç®¡ç† (ä»…ä½œå¯¹æ¯”ï¼Œä¸è¦è¿™æ ·åš)
     */
    public void processLOB_Wrong() {
        Connection conn = null;
        PreparedStatement ps = null;
        ResultSet rs = null;
        InputStream is = null;
        
        try {
            conn = getConnection();
            ps = conn.prepareStatement("SELECT data FROM files WHERE id=1");
            rs = ps.executeQuery();
            
            if (rs.next()) {
                Blob blob = rs.getBlob("data");
                is = blob.getBinaryStream();
                // å¤„ç†æ•°æ®...
            }
            
        } catch (Exception e) {
            e.printStackTrace();
        }
        // âŒ æ²¡æœ‰å…³é—­èµ„æºï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼ï¼
    }
}
```

---

## 6. ğŸ› ï¸ å®æˆ˜åº”ç”¨åœºæ™¯


### 6.1 ç”¨æˆ·å¤´åƒç®¡ç†ç³»ç»Ÿ


**ğŸ‘¤ å®Œæ•´çš„å¤´åƒç®¡ç†å®ç°**

```java
public class AvatarManager {
    
    /**
     * ç”¨æˆ·ä¸Šä¼ å¤´åƒ
     */
    public boolean uploadAvatar(int userId, MultipartFile file) {
        // ğŸ” æ–‡ä»¶éªŒè¯
        if (!isValidImage(file)) {
            System.out.println("âŒ æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·ä¸Šä¼ jpgã€pngã€gifæ ¼å¼çš„å›¾ç‰‡");
            return false;
        }
        
        // ğŸ“ å¤§å°é™åˆ¶ (5MB)
        if (file.getSize() > 5 * 1024 * 1024) {
            System.out.println("âŒ æ–‡ä»¶å¤ªå¤§ï¼Œè¯·ä¸Šä¼ å°äº5MBçš„å›¾ç‰‡");
            return false;
        }
        
        String sql = "UPDATE users SET avatar = ?, avatar_size = ? WHERE user_id = ?";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql);
             InputStream is = file.getInputStream()) {
            
            ps.setBinaryStream(1, is, file.getSize());
            ps.setLong(2, file.getSize());
            ps.setInt(3, userId);
            
            int result = ps.executeUpdate();
            
            if (result > 0) {
                System.out.println("âœ… å¤´åƒä¸Šä¼ æˆåŠŸï¼");
                return true;
            }
            
        } catch (Exception e) {
            System.err.println("å¤´åƒä¸Šä¼ å¤±è´¥: " + e.getMessage());
        }
        
        return false;
    }
    
    /**
     * è·å–ç”¨æˆ·å¤´åƒ
     */
    public void getAvatar(int userId, HttpServletResponse response) {
        String sql = "SELECT avatar, avatar_size FROM users WHERE user_id = ?";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setInt(1, userId);
            ResultSet rs = ps.executeQuery();
            
            if (rs.next()) {
                Blob avatar = rs.getBlob("avatar");
                
                if (avatar != null) {
                    // ğŸ“¤ è®¾ç½®å“åº”å¤´
                    response.setContentType("image/jpeg");
                    response.setContentLength((int) avatar.length());
                    
                    // ğŸš€ æµå¼è¾“å‡ºåˆ°æµè§ˆå™¨
                    try (InputStream is = avatar.getBinaryStream();
                         OutputStream os = response.getOutputStream()) {
                        
                        byte[] buffer = new byte[4096];
                        int bytesRead;
                        
                        while ((bytesRead = is.read(buffer)) != -1) {
                            os.write(buffer, 0, bytesRead);
                        }
                    }
                } else {
                    // ğŸ“· è¿”å›é»˜è®¤å¤´åƒ
                    sendDefaultAvatar(response);
                }
            }
            
        } catch (Exception e) {
            System.err.println("è·å–å¤´åƒå¤±è´¥: " + e.getMessage());
        }
    }
}
```

### 6.2 åšå®¢æ–‡ç« ç®¡ç†


**ğŸ“ åšå®¢å†…å®¹çš„å®Œæ•´å¤„ç†**

```java
public class BlogManager {
    
    /**
     * å‘å¸ƒåšå®¢æ–‡ç« 
     */
    public boolean publishPost(BlogPost post) {
        String sql = "INSERT INTO blog_posts (title, content, summary, author_id, create_time) VALUES (?, ?, ?, ?, NOW())";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setString(1, post.getTitle());
            
            // ğŸ”‘ é•¿æ–‡ç« å†…å®¹ç”¨CLOBå­˜å‚¨
            StringReader contentReader = new StringReader(post.getContent());
            ps.setCharacterStream(2, contentReader, post.getContent().length());
            
            // ğŸ“„ æ‘˜è¦ç”¨æ™®é€šVARCHAR
            ps.setString(3, generateSummary(post.getContent()));
            ps.setInt(4, post.getAuthorId());
            
            int result = ps.executeUpdate();
            
            if (result > 0) {
                System.out.println("âœ… åšå®¢å‘å¸ƒæˆåŠŸï¼");
                System.out.println("   æ ‡é¢˜: " + post.getTitle());
                System.out.println("   å­—æ•°: " + post.getContent().length() + " å­—ç¬¦");
                return true;
            }
            
        } catch (Exception e) {
            System.err.println("åšå®¢å‘å¸ƒå¤±è´¥: " + e.getMessage());
        }
        
        return false;
    }
    
    /**
     * è·å–åšå®¢æ–‡ç« è¯¦æƒ…
     */
    public BlogPost getPostDetail(int postId) {
        String sql = "SELECT title, content, summary, author_id, create_time FROM blog_posts WHERE post_id = ?";
        
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setInt(1, postId);
            ResultSet rs = ps.executeQuery();
            
            if (rs.next()) {
                BlogPost post = new BlogPost();
                post.setTitle(rs.getString("title"));
                post.setSummary(rs.getString("summary"));
                post.setAuthorId(rs.getInt("author_id"));
                post.setCreateTime(rs.getTimestamp("create_time"));
                
                // ğŸ”„ å¤„ç†é•¿æ–‡æœ¬å†…å®¹
                String content = rs.getString("content");
                post.setContent(content);
                
                System.out.println("ğŸ“– è·å–æ–‡ç« : " + post.getTitle() + 
                                 " (å†…å®¹é•¿åº¦: " + content.length() + " å­—ç¬¦)");
                
                return post;
            }
            
        } catch (Exception e) {
            System.err.println("è·å–æ–‡ç« å¤±è´¥: " + e.getMessage());
        }
        
        return null;
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ LOBæœ¬è´¨ï¼šæ•°æ®åº“ä¸­çš„"å¤§å®¹é‡ä¿é™©æŸœ"ï¼Œä¸“é—¨å­˜å‚¨å¤§æ•°æ®
ğŸ”¸ BLOB vs CLOBï¼šäºŒè¿›åˆ¶æ•°æ® vs æ–‡æœ¬æ•°æ®çš„åŒºåˆ«
ğŸ”¸ æµå¼å¤„ç†ï¼šåƒ"æ°´ç®¡è¾“æ°´"ä¸€æ ·å¤„ç†å¤§æ•°æ®ï¼Œé¿å…å†…å­˜æº¢å‡º
ğŸ”¸ ç¼“å†²åŒºæ¦‚å¿µï¼šåˆç†çš„"ä¸­è½¬ç«™"å¤§å°ï¼Œå¹³è¡¡æ€§èƒ½å’Œå†…å­˜å ç”¨
ğŸ”¸ èµ„æºç®¡ç†ï¼šæ­£ç¡®å…³é—­æµå’Œè¿æ¥ï¼Œé¿å…å†…å­˜æ³„æ¼
```

### 7.2 å…³é”®æ“ä½œè¦ç‚¹


**ğŸ”¹ å­˜å‚¨LOBçš„æ­£ç¡®å§¿åŠ¿**
```
BLOBå­˜å‚¨ï¼š
â€¢ ä½¿ç”¨ setBinaryStream(ä½ç½®, InputStream, é•¿åº¦)
â€¢ é…åˆ FileInputStream è¯»å–æ–‡ä»¶
â€¢ é€‚ç”¨äºå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰äºŒè¿›åˆ¶æ–‡ä»¶

CLOBå­˜å‚¨ï¼š
â€¢ ä½¿ç”¨ setCharacterStream(ä½ç½®, Reader, é•¿åº¦)  
â€¢ é…åˆ StringReader å¤„ç†æ–‡æœ¬
â€¢ é€‚ç”¨äºæ–‡ç« ã€æ—¥å¿—ã€æè¿°ç­‰æ–‡æœ¬å†…å®¹
```

**ğŸ”¹ è¯»å–LOBçš„æ­£ç¡®å§¿åŠ¿**
```
BLOBè¯»å–ï¼š
â€¢ rs.getBlob() è·å–BLOBå¯¹è±¡
â€¢ blob.getBinaryStream() è·å–è¾“å…¥æµ
â€¢ åˆ†å—è¯»å–: byte[] buffer = new byte[8192]

CLOBè¯»å–ï¼š
â€¢ rs.getClob() è·å–CLOBå¯¹è±¡æˆ–ç›´æ¥ rs.getString()
â€¢ clob.getCharacterStream() è·å–å­—ç¬¦æµ
â€¢ åˆ†å—è¯»å–: char[] buffer = new char[4096]
```

### 7.3 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹


**ğŸ“Š å†…å­˜æ§åˆ¶ç­–ç•¥**
```
ç¼“å†²åŒºå¤§å°é€‰æ‹©ï¼š
â€¢ å°æ–‡ä»¶ (<1MB): 4KB ç¼“å†²åŒº
â€¢ ä¸­æ–‡ä»¶ (1-10MB): 8KB ç¼“å†²åŒº  
â€¢ å¤§æ–‡ä»¶ (>10MB): 64KB ç¼“å†²åŒº

å†…å­˜å®‰å…¨åŸåˆ™ï¼š
â€¢ æ°¸è¿œä¸è¦æŠŠå¤§æ–‡ä»¶ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜
â€¢ å§‹ç»ˆä½¿ç”¨æµå¼å¤„ç†
â€¢ åˆç†è®¾ç½®ç¼“å†²åŒºå¤§å°
```

**âš¡ å®é™…åº”ç”¨å»ºè®®**
```
é€‚ç”¨åœºæ™¯åˆ¤æ–­ï¼š
âœ… æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ (å¤´åƒã€é™„ä»¶)
âœ… é•¿æ–‡æœ¬å­˜å‚¨ (åšå®¢ã€æè¿°)  
âœ… åª’ä½“å†…å®¹ç®¡ç† (å›¾ç‰‡ã€éŸ³é¢‘)

ä¸é€‚ç”¨åœºæ™¯ï¼š
âŒ é¢‘ç¹æŸ¥è¯¢çš„å°æ•°æ®
âŒ éœ€è¦æ¨¡ç³Šæœç´¢çš„æ–‡æœ¬
âŒ éœ€è¦æ•°æ®åº“å‡½æ•°å¤„ç†çš„å†…å®¹
```

### 7.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**ğŸ”§ é—®é¢˜æ’æŸ¥æ¸…å•**

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|
| `OutOfMemoryError` | `ä¸€æ¬¡æ€§è¯»å–å¤§æ–‡ä»¶` | `æ”¹ç”¨æµå¼å¤„ç†` |
| `æ–‡ä»¶æŸå` | `æœªæ­£ç¡®è®¾ç½®æ•°æ®é•¿åº¦` | `ç¡®ä¿lengthå‚æ•°æ­£ç¡®` |
| `è¿æ¥è¶…æ—¶` | `å¤§æ–‡ä»¶ä¼ è¾“æ—¶é—´é•¿` | `è°ƒæ•´æ•°æ®åº“è¶…æ—¶è®¾ç½®` |
| `æ€§èƒ½å¾ˆæ…¢` | `ç¼“å†²åŒºå¤ªå°` | `é€‚å½“å¢å¤§ç¼“å†²åŒº` |

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- LOBæ˜¯æ•°æ®åº“çš„"å¤§ä¿é™©æŸœ"ï¼ŒBLOBè£…äºŒè¿›åˆ¶ï¼ŒCLOBè£…æ–‡æœ¬
- æµå¼å¤„ç†åƒ"æ°´ç®¡è¾“æ°´"ï¼Œé¿å…å†…å­˜æ’‘çˆ†
- åˆç†ç¼“å†²åŒºæ˜¯å…³é”®ï¼Œèµ„æºç®¡ç†è¦åšå¥½
- é€‚åˆå¤§æ•°æ®å­˜å‚¨ï¼Œä¸é€‚åˆé¢‘ç¹æŸ¥è¯¢