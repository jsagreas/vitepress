---
title: 3ã€PreparedStatementæ‰¹å¤„ç†
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯æ‰¹å¤„ç†](#1-ä»€ä¹ˆæ˜¯æ‰¹å¤„ç†)
2. [ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ‰¹å¤„ç†](#2-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ‰¹å¤„ç†)
3. [PreparedStatementæ‰¹å¤„ç†åŸºç¡€](#3-PreparedStatementæ‰¹å¤„ç†åŸºç¡€)
4. [æ‰¹å¤„ç†æœ€ä½³å®è·µ](#4-æ‰¹å¤„ç†æœ€ä½³å®è·µ)
5. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#5-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
6. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#6-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ ä»€ä¹ˆæ˜¯æ‰¹å¤„ç†


### 1.1 æ‰¹å¤„ç†çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ‰¹å¤„ç†ï¼Ÿ**
```
ç®€å•ç†è§£ï¼šæ‰¹å¤„ç†å°±åƒ"æ‰“åŒ…å‘å¿«é€’"
- æ™®é€šå¤„ç†ï¼šæ¯æ¬¡åªå‘ä¸€ä»¶å¿«é€’ï¼Œè·‘ä¸€æ¬¡å¿«é€’ç‚¹
- æ‰¹å¤„ç†ï¼šæŠŠ10ä»¶å¿«é€’æ‰“åŒ…ä¸€èµ·å‘ï¼Œåªè·‘ä¸€æ¬¡å¿«é€’ç‚¹

æ•°æ®åº“æ‰¹å¤„ç†ï¼š
æŠŠå¤šä¸ªSQLæ“ä½œ"æ‰“åŒ…"ä¸€èµ·æ‰§è¡Œï¼Œå‡å°‘æ•°æ®åº“äº¤äº’æ¬¡æ•°
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
> ğŸª **è¶…å¸‚è´­ç‰©ç±»æ¯”**ï¼š
> - ä¼ ç»Ÿæ–¹å¼ï¼šä¹°ä¸€æ ·ä¸œè¥¿ç»“è´¦ä¸€æ¬¡ï¼Œä¹°10æ ·ä¸œè¥¿è¦ç»“è´¦10æ¬¡
> - æ‰¹å¤„ç†ï¼šæŠŠ10æ ·ä¸œè¥¿æ”¾è´­ç‰©è½¦é‡Œï¼Œæœ€åä¸€æ¬¡æ€§ç»“è´¦

### 1.2 æ‰¹å¤„ç† vs æ™®é€šå¤„ç†


**å¯¹æ¯”ç¤ºæ„å›¾**
```
æ™®é€šå¤„ç†æµç¨‹ï¼š
Javaç¨‹åº --SQL1--> æ•°æ®åº“ --ç»“æœ1--> Javaç¨‹åº
Javaç¨‹åº --SQL2--> æ•°æ®åº“ --ç»“æœ2--> Javaç¨‹åº  
Javaç¨‹åº --SQL3--> æ•°æ®åº“ --ç»“æœ3--> Javaç¨‹åº
ç½‘ç»œå¾€è¿”ï¼š3æ¬¡

æ‰¹å¤„ç†æµç¨‹ï¼š
Javaç¨‹åº --[SQL1,SQL2,SQL3]--> æ•°æ®åº“ --[ç»“æœ1,ç»“æœ2,ç»“æœ3]--> Javaç¨‹åº
ç½‘ç»œå¾€è¿”ï¼š1æ¬¡
```

**ğŸ”´ æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **å‡å°‘ç½‘ç»œäº¤äº’**ï¼šåŸæ¥næ¬¡å˜æˆ1æ¬¡
- **æé«˜æ‰§è¡Œæ•ˆç‡**ï¼šæ•°æ®åº“å¯ä»¥ä¼˜åŒ–æ‰§è¡Œè®¡åˆ’
- **èŠ‚çœèµ„æºå¼€é”€**ï¼šå‡å°‘è¿æ¥å’Œé€šä¿¡æˆæœ¬

---

## 2. âš¡ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ‰¹å¤„ç†


### 2.1 æ€§èƒ½é—®é¢˜çš„æ ¹æº


**ğŸ”¸ ç½‘ç»œå»¶è¿Ÿæ˜¯ç“¶é¢ˆ**
```
å‡è®¾åœºæ™¯ï¼šæ’å…¥1000æ¡ç”¨æˆ·æ•°æ®

æ™®é€šæ–¹å¼æ‰§è¡Œæ—¶é—´åˆ†æï¼š
- æ¯æ¬¡SQLæ‰§è¡Œï¼š1ms
- ç½‘ç»œå¾€è¿”å»¶è¿Ÿï¼š5ms  
- æ€»æ—¶é—´ï¼š(1ms + 5ms) Ã— 1000 = 6ç§’

æ‰¹å¤„ç†æ‰§è¡Œæ—¶é—´ï¼š
- æ‰¹å¤„ç†SQLæ‰§è¡Œï¼š100ms
- ç½‘ç»œå¾€è¿”ï¼š5ms
- æ€»æ—¶é—´ï¼š100ms + 5ms = 0.1ç§’

æ€§èƒ½æå‡ï¼š6ç§’ â†’ 0.1ç§’ï¼Œå¿«äº†60å€ï¼
```

### 2.2 å®é™…åœºæ™¯éœ€æ±‚


**å¸¸è§æ‰¹å¤„ç†åœºæ™¯**ï¼š
- ğŸ“Š **æ•°æ®å¯¼å…¥**ï¼šExcelå¯¼å…¥å‡ åƒæ¡å•†å“ä¿¡æ¯
- ğŸ“ˆ **æ—¥å¿—è®°å½•**ï¼šæ‰¹é‡ä¿å­˜ç”¨æˆ·æ“ä½œæ—¥å¿—  
- ğŸ”„ **æ•°æ®åŒæ­¥**ï¼šå®šæ—¶åŒæ­¥å…¶ä»–ç³»ç»Ÿæ•°æ®
- ğŸ“‹ **æŠ¥è¡¨ç”Ÿæˆ**ï¼šæ‰¹é‡æ›´æ–°ç»Ÿè®¡æ•°æ®

**ğŸ¤” æ€è€ƒé¢˜**ï¼š
ä¸ºä»€ä¹ˆç½‘ä¸Šè´­ç‰©è½¦å¯ä»¥ä¸€æ¬¡æ€§ç»“ç®—å¤šä¸ªå•†å“ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªå•ç‹¬ä»˜æ¬¾ï¼Ÿ
ç­”æ¡ˆï¼šå’Œæ‰¹å¤„ç†æ˜¯åŒæ ·çš„é“ç† - å‡å°‘äº¤äº’æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡ï¼

---

## 3. ğŸ”§ PreparedStatementæ‰¹å¤„ç†åŸºç¡€


### 3.1 æ‰¹å¤„ç†çš„æ ¸å¿ƒæ–¹æ³•


**åŸºæœ¬APIä»‹ç»**
| æ–¹æ³• | **ä½œç”¨** | **é€šä¿—ç†è§£** |
|------|----------|-------------|
| `addBatch()` | æ·»åŠ SQLåˆ°æ‰¹å¤„ç†é˜Ÿåˆ— | æŠŠå•†å“æ”¾è¿›è´­ç‰©è½¦ |
| `executeBatch()` | æ‰§è¡Œæ‰€æœ‰æ‰¹å¤„ç†SQL | è´­ç‰©è½¦ä¸€æ¬¡æ€§ç»“è´¦ |
| `clearBatch()` | æ¸…ç©ºæ‰¹å¤„ç†é˜Ÿåˆ— | æ¸…ç©ºè´­ç‰©è½¦ |

### 3.2 æ‰¹å¤„ç†åŸºæœ¬å®ç°


**ğŸ¯ æ ‡å‡†æ‰¹å¤„ç†æµç¨‹**
```java
// ç¬¬1æ­¥ï¼šå‡†å¤‡SQLæ¨¡æ¿
String sql = "INSERT INTO users (name, email, age) VALUES (?, ?, ?)";
PreparedStatement pst = conn.prepareStatement(sql);

// ç¬¬2æ­¥ï¼šæ·»åŠ å¤šç»„å‚æ•°åˆ°æ‰¹å¤„ç†
pst.setString(1, "å¼ ä¸‰");
pst.setString(2, "zhangsan@qq.com"); 
pst.setInt(3, 25);
pst.addBatch(); // æŠŠè¿™ç»„å‚æ•°åŠ å…¥æ‰¹å¤„ç†é˜Ÿåˆ—

pst.setString(1, "æå››");
pst.setString(2, "lisi@qq.com");
pst.setInt(3, 28);
pst.addBatch(); // å†åŠ ä¸€ç»„å‚æ•°

// ç¬¬3æ­¥ï¼šä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰æ‰¹å¤„ç†
int[] results = pst.executeBatch(); // è¿”å›æ¯æ¡SQLå½±å“çš„è¡Œæ•°
```

**ğŸ”¸ ä»£ç è¯¦è§£**ï¼š
- `addBatch()`ï¼šåƒå¾€è´­ç‰©è½¦é‡Œæ”¾å•†å“ï¼Œä¸ç«‹å³ç»“è´¦
- `executeBatch()`ï¼šä¸€æ¬¡æ€§ç»“è´¦ï¼Œè¿”å›æ¯ä¸ªå•†å“çš„å¤„ç†ç»“æœ
- `resultsæ•°ç»„`ï¼šæ¯ä¸ªä½ç½®è®°å½•å¯¹åº”SQLå½±å“çš„è¡Œæ•°

### 3.3 å®Œæ•´çš„æ‰¹å¤„ç†ç¤ºä¾‹


```java
public class BatchInsertExample {
    
    // æ‰¹é‡æ’å…¥ç”¨æˆ·æ•°æ®
    public void batchInsertUsers(List<User> users) {
        String sql = "INSERT INTO users (name, email, age) VALUES (?, ?, ?)";
        
        try (PreparedStatement pst = conn.prepareStatement(sql)) {
            
            for (User user : users) {
                // è®¾ç½®å‚æ•°
                pst.setString(1, user.getName());
                pst.setString(2, user.getEmail());
                pst.setInt(3, user.getAge());
                
                // åŠ å…¥æ‰¹å¤„ç†é˜Ÿåˆ—
                pst.addBatch();
            }
            
            // æ‰§è¡Œæ‰¹å¤„ç†
            int[] results = pst.executeBatch();
            
            System.out.println("æ‰¹å¤„ç†å®Œæˆï¼Œå…±å¤„ç† " + results.length + " æ¡æ•°æ®");
            
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

---

## 4. ğŸ’¡ æ‰¹å¤„ç†æœ€ä½³å®è·µ


### 4.1 åˆ†æ‰¹å¤„ç†å¤§æ•°æ®é‡


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦åˆ†æ‰¹ï¼Ÿ**
```
é—®é¢˜åœºæ™¯ï¼šéœ€è¦æ’å…¥10ä¸‡æ¡æ•°æ®

å¦‚æœä¸€æ¬¡æ€§æ‰¹å¤„ç†ï¼š
- å†…å­˜å ç”¨ï¼š10ä¸‡æ¡ Ã— æ¯æ¡100å­—èŠ‚ = 10MB
- æ‰§è¡Œæ—¶é—´ï¼šå¯èƒ½è¶…æ—¶
- å›æ»šé£é™©ï¼šå…¨éƒ¨å¤±è´¥

åˆ†æ‰¹å¤„ç†æ–¹æ¡ˆï¼š
- æ¯æ‰¹1000æ¡ï¼Œåˆ†100æ¬¡å¤„ç†
- å†…å­˜å ç”¨ï¼š1000æ¡ Ã— 100å­—èŠ‚ = 100KB  
- å¤±è´¥å½±å“ï¼šæœ€å¤šæŸå¤±1000æ¡ï¼Œå…¶ä»–99æ‰¹æ­£å¸¸
```

**ğŸ“Š åˆ†æ‰¹å¤„ç†å®ç°**
```java
public void batchInsertLargeData(List<User> users) {
    final int BATCH_SIZE = 1000; // æ¯æ‰¹å¤„ç†1000æ¡
    String sql = "INSERT INTO users (name, email, age) VALUES (?, ?, ?)";
    
    try (PreparedStatement pst = conn.prepareStatement(sql)) {
        
        for (int i = 0; i < users.size(); i++) {
            User user = users.get(i);
            
            // è®¾ç½®å‚æ•°
            pst.setString(1, user.getName());
            pst.setString(2, user.getEmail()); 
            pst.setInt(3, user.getAge());
            pst.addBatch();
            
            // æ¯1000æ¡æ‰§è¡Œä¸€æ¬¡æ‰¹å¤„ç†
            if ((i + 1) % BATCH_SIZE == 0) {
                pst.executeBatch();
                pst.clearBatch(); // æ¸…ç©ºæ‰¹å¤„ç†é˜Ÿåˆ—
                System.out.println("å·²å¤„ç† " + (i + 1) + " æ¡æ•°æ®");
            }
        }
        
        // å¤„ç†å‰©ä½™æ•°æ®
        pst.executeBatch();
        
    } catch (SQLException e) {
        e.printStackTrace();
    }
}
```

### 4.2 äº‹åŠ¡æ§åˆ¶æœ€ä½³å®è·µ


**ğŸ”´ å¿…é¡»è¦è€ƒè™‘äº‹åŠ¡**
```
æ‰¹å¤„ç† + äº‹åŠ¡ = æ•°æ®å®‰å…¨ä¿éšœ

åœºæ™¯ï¼šæ‰¹é‡æ’å…¥è®¢å•æ•°æ®ï¼Œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥
- ä¸ç”¨äº‹åŠ¡ï¼šæ’å…¥åˆ°ç¬¬800æ¡å‡ºé”™ï¼Œå‰799æ¡å·²å…¥åº“ï¼Œæ•°æ®ä¸å®Œæ•´
- ä½¿ç”¨äº‹åŠ¡ï¼šä»»ä½•ä¸€æ¡å‡ºé”™ï¼Œå…¨éƒ¨å›æ»šï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
```

```java
public void batchInsertWithTransaction(List<Order> orders) {
    String sql = "INSERT INTO orders (user_id, product_id, quantity, price) VALUES (?, ?, ?, ?)";
    
    try {
        // å¼€å§‹äº‹åŠ¡
        conn.setAutoCommit(false);
        
        try (PreparedStatement pst = conn.prepareStatement(sql)) {
            
            for (Order order : orders) {
                pst.setInt(1, order.getUserId());
                pst.setInt(2, order.getProductId());
                pst.setInt(3, order.getQuantity());
                pst.setBigDecimal(4, order.getPrice());
                pst.addBatch();
            }
            
            // æ‰§è¡Œæ‰¹å¤„ç†
            int[] results = pst.executeBatch();
            
            // æäº¤äº‹åŠ¡
            conn.commit();
            System.out.println("æ‰¹å¤„ç†æˆåŠŸï¼Œå…±æ’å…¥ " + results.length + " æ¡è®¢å•");
            
        } catch (SQLException e) {
            // å‡ºé”™æ—¶å›æ»š
            conn.rollback();
            System.out.println("æ‰¹å¤„ç†å¤±è´¥ï¼Œå·²å›æ»šæ‰€æœ‰æ“ä½œ");
            throw e;
        }
        
    } catch (SQLException e) {
        e.printStackTrace();
    } finally {
        // æ¢å¤è‡ªåŠ¨æäº¤
        try {
            conn.setAutoCommit(true);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

---

## 5. ğŸï¸ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 5.1 æ‰¹å¤„ç†å¤§å°ä¼˜åŒ–


**ğŸ”¸ æ‰¹å¤„ç†å¤§å°çš„é€‰æ‹©**
```
æ‰¹å¤„ç†å¤§å°å½±å“å› ç´ ï¼š

å¤ªå°ï¼ˆå¦‚10æ¡ï¼‰ï¼š
ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨å°‘ï¼Œå‡ºé”™å½±å“å°
ç¼ºç‚¹ï¼šç½‘ç»œäº¤äº’è¿˜æ˜¯å¤ªé¢‘ç¹

å¤ªå¤§ï¼ˆå¦‚10ä¸‡æ¡ï¼‰ï¼š
ä¼˜ç‚¹ï¼šç½‘ç»œäº¤äº’å°‘
ç¼ºç‚¹ï¼šå†…å­˜å ç”¨å¤§ï¼Œå¯èƒ½è¶…æ—¶ï¼Œå›æ»šä»£ä»·é«˜

æœ€ä½³å®è·µï¼š
- æ™®é€šåº”ç”¨ï¼š1000-5000æ¡/æ‰¹
- å¤§æ•°æ®å¤„ç†ï¼š10000-50000æ¡/æ‰¹  
- å†…å­˜å—é™ï¼š500-1000æ¡/æ‰¹
```

**ğŸ“ˆ æ€§èƒ½æµ‹è¯•å¯¹æ¯”**
| æ‰¹å¤„ç†å¤§å° | **10ä¸‡æ¡æ•°æ®è€—æ—¶** | **å†…å­˜å ç”¨** | **æ¨èåœºæ™¯** |
|-----------|------------------|-------------|-------------|
| 100æ¡/æ‰¹ | 45ç§’ | ä½ | å†…å­˜ç´§å¼ ç¯å¢ƒ |
| 1000æ¡/æ‰¹ | 8ç§’ | ä¸­ç­‰ | **é€šç”¨æ¨è** |
| 5000æ¡/æ‰¹ | 3ç§’ | è¾ƒé«˜ | æ€§èƒ½ä¼˜å…ˆ |
| 50000æ¡/æ‰¹ | 2ç§’ | å¾ˆé«˜ | å¤§æ•°æ®å¤„ç† |

### 5.2 å†…å­˜ç®¡ç†ä¼˜åŒ–


**âš ï¸ å†…å­˜æº¢å‡ºé¢„é˜²**
```java
public void memoryOptimizedBatch(List<User> users) {
    final int BATCH_SIZE = 2000;
    String sql = "INSERT INTO users (name, email, age) VALUES (?, ?, ?)";
    
    try (PreparedStatement pst = conn.prepareStatement(sql)) {
        
        int processedCount = 0;
        
        for (User user : users) {
            pst.setString(1, user.getName());
            pst.setString(2, user.getEmail());
            pst.setInt(3, user.getAge());
            pst.addBatch();
            processedCount++;
            
            // å®šæœŸæ‰§è¡Œæ‰¹å¤„ç†å¹¶æ¸…ç†å†…å­˜
            if (processedCount % BATCH_SIZE == 0) {
                pst.executeBatch();
                pst.clearBatch(); // é‡è¦ï¼šæ¸…ç©ºæ‰¹å¤„ç†é˜Ÿåˆ—é‡Šæ”¾å†…å­˜
                
                // å»ºè®®JVMè¿›è¡Œåƒåœ¾å›æ”¶
                System.gc();
                
                System.out.println("å·²å¤„ç†: " + processedCount + "/" + users.size());
            }
        }
        
        // å¤„ç†å‰©ä½™æ•°æ®
        if (processedCount % BATCH_SIZE != 0) {
            pst.executeBatch();
        }
        
    } catch (SQLException e) {
        e.printStackTrace();
    }
}
```

### 5.3 æ•°æ®åº“å‚æ•°ä¼˜åŒ–


**ğŸ”§ MySQLä¼˜åŒ–å‚æ•°**
```sql
-- ä¸´æ—¶è°ƒæ•´æ‰¹å¤„ç†ç›¸å…³å‚æ•°
SET SESSION bulk_insert_buffer_size = 256M;  -- æ‰¹é‡æ’å…¥ç¼“å†²åŒº
SET SESSION max_allowed_packet = 64M;        -- æœ€å¤§æ•°æ®åŒ…å¤§å°
SET SESSION innodb_buffer_pool_size = 1G;    -- InnoDBç¼“å†²æ± 
```

**ğŸ“‹ æ•°æ®åº“è¿æ¥ä¼˜åŒ–**
```java
// è¿æ¥URLä¼˜åŒ–å‚æ•°
String url = "jdbc:mysql://localhost:3306/testdb" +
    "?rewriteBatchedStatements=true" +      // å¼€å¯æ‰¹å¤„ç†é‡å†™
    "&useServerPrepStmts=false" +           // å…³é—­æœåŠ¡å™¨é¢„å¤„ç†
    "&cachePrepStmts=true" +                // ç¼“å­˜é¢„å¤„ç†è¯­å¥
    "&prepStmtCacheSize=250";               // é¢„å¤„ç†è¯­å¥ç¼“å­˜å¤§å°
```

---

## 6. ğŸ” å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


### 6.1 æ‰¹å¤„ç†å¼‚å¸¸å¤„ç†


**ğŸ”¸ éƒ¨åˆ†æˆåŠŸçš„å¤„ç†**
```java
public void handleBatchExceptions() {
    String sql = "INSERT INTO users (name, email, age) VALUES (?, ?, ?)";
    
    try (PreparedStatement pst = conn.prepareStatement(sql)) {
        
        // æ·»åŠ ä¸€äº›æµ‹è¯•æ•°æ®ï¼ŒåŒ…å«ä¸€æ¡é”™è¯¯æ•°æ®
        pst.setString(1, "æ­£å¸¸ç”¨æˆ·1");
        pst.setString(2, "user1@qq.com");
        pst.setInt(3, 25);
        pst.addBatch();
        
        pst.setString(1, "é”™è¯¯ç”¨æˆ·");
        pst.setString(2, "æ— æ•ˆé‚®ç®±æ ¼å¼"); // å‡è®¾è¿™é‡Œä¼šå¯¼è‡´çº¦æŸè¿å
        pst.setInt(3, -5); // è´Ÿæ•°å¹´é¾„ï¼Œè¿åæ£€æŸ¥çº¦æŸ
        pst.addBatch();
        
        pst.setString(1, "æ­£å¸¸ç”¨æˆ·2");
        pst.setString(2, "user2@qq.com");
        pst.setInt(3, 30);
        pst.addBatch();
        
        try {
            int[] results = pst.executeBatch();
            
            // æ£€æŸ¥æ¯æ¡è®°å½•çš„æ‰§è¡Œç»“æœ
            for (int i = 0; i < results.length; i++) {
                if (results[i] == Statement.EXECUTE_FAILED) {
                    System.out.println("ç¬¬ " + (i+1) + " æ¡è®°å½•æ‰§è¡Œå¤±è´¥");
                } else {
                    System.out.println("ç¬¬ " + (i+1) + " æ¡è®°å½•æˆåŠŸï¼Œå½±å“è¡Œæ•°: " + results[i]);
                }
            }
            
        } catch (BatchUpdateException e) {
            System.out.println("æ‰¹å¤„ç†éƒ¨åˆ†å¤±è´¥:");
            
            // è·å–æˆåŠŸæ‰§è¡Œçš„ç»“æœ
            int[] successResults = e.getUpdateCounts();
            for (int i = 0; i < successResults.length; i++) {
                System.out.println("è®°å½• " + (i+1) + " ç»“æœ: " + successResults[i]);
            }
            
            // è¾“å‡ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
            System.out.println("é”™è¯¯ä¿¡æ¯: " + e.getMessage());
        }
        
    } catch (SQLException e) {
        e.printStackTrace();
    }
}
```

### 6.2 æ€§èƒ½ç›‘æ§


**ğŸ“Š æ‰¹å¤„ç†æ€§èƒ½ç›‘æ§**
```java
public class BatchPerformanceMonitor {
    
    public void monitoredBatchInsert(List<User> users) {
        final int BATCH_SIZE = 1000;
        String sql = "INSERT INTO users (name, email, age) VALUES (?, ?, ?)";
        
        // è®°å½•å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        int totalProcessed = 0;
        
        try (PreparedStatement pst = conn.prepareStatement(sql)) {
            
            for (int i = 0; i < users.size(); i++) {
                User user = users.get(i);
                
                pst.setString(1, user.getName());
                pst.setString(2, user.getEmail());
                pst.setInt(3, user.getAge());
                pst.addBatch();
                
                if ((i + 1) % BATCH_SIZE == 0) {
                    // æ‰§è¡Œæ‰¹å¤„ç†å¹¶è®°å½•æ€§èƒ½
                    long batchStart = System.currentTimeMillis();
                    pst.executeBatch();
                    long batchEnd = System.currentTimeMillis();
                    
                    totalProcessed += BATCH_SIZE;
                    pst.clearBatch();
                    
                    // è®¡ç®—æ€§èƒ½æŒ‡æ ‡
                    long batchTime = batchEnd - batchStart;
                    double throughput = (double) BATCH_SIZE / batchTime * 1000; // æ¯ç§’å¤„ç†æ¡æ•°
                    
                    System.out.printf("æ‰¹æ¬¡ %d: %d æ¡æ•°æ®ï¼Œè€—æ—¶ %d msï¼Œååé‡ %.2f æ¡/ç§’%n",
                        totalProcessed / BATCH_SIZE, BATCH_SIZE, batchTime, throughput);
                }
            }
            
            // å¤„ç†å‰©ä½™æ•°æ®
            if (users.size() % BATCH_SIZE != 0) {
                pst.executeBatch();
                totalProcessed = users.size();
            }
            
            // è¾“å‡ºæ€»ä½“æ€§èƒ½
            long totalTime = System.currentTimeMillis() - startTime;
            double overallThroughput = (double) totalProcessed / totalTime * 1000;
            
            System.out.printf("æ‰¹å¤„ç†å®Œæˆ: æ€»å…± %d æ¡æ•°æ®ï¼Œæ€»è€—æ—¶ %d msï¼Œå¹³å‡ååé‡ %.2f æ¡/ç§’%n",
                totalProcessed, totalTime, overallThroughput);
                
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”´ æ‰¹å¤„ç†ä¸‰è¦ç´ **
- **`addBatch()`**ï¼šæŠŠSQLåŠ å…¥é˜Ÿåˆ—ï¼Œåƒå¾€è´­ç‰©è½¦æ”¾å•†å“
- **`executeBatch()`**ï¼šä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰SQLï¼Œåƒè´­ç‰©è½¦ç»“è´¦
- **`clearBatch()`**ï¼šæ¸…ç©ºé˜Ÿåˆ—é‡Šæ”¾å†…å­˜ï¼Œåƒæ¸…ç©ºè´­ç‰©è½¦

**ğŸ”´ æ‰¹å¤„ç†é€‚ç”¨åœºæ™¯**
- å¤§é‡æ•°æ®æ’å…¥/æ›´æ–°/åˆ é™¤æ“ä½œ
- æ•°æ®å¯¼å…¥å¯¼å‡º
- æ—¥å¿—æ‰¹é‡å†™å…¥
- å®šæ—¶æ•°æ®åŒæ­¥

### 7.2 æ€§èƒ½ä¼˜åŒ–è®°å¿†è¦ç‚¹


**ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–ä¸‰åŸåˆ™**
```
1. æ§åˆ¶æ‰¹æ¬¡å¤§å°ï¼š1000-5000æ¡æœ€ä½³
2. åŠæ—¶æ¸…ç†å†…å­˜ï¼šå®šæœŸclearBatch()
3. åˆç†ä½¿ç”¨äº‹åŠ¡ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§
```

**âš ï¸ é¿å…å¸¸è§é”™è¯¯**
```
âŒ é”™è¯¯åšæ³•ï¼š
- æ‰¹å¤„ç†ä¸æ§åˆ¶å¤§å°ï¼Œä¸€æ¬¡å¤„ç†10ä¸‡æ¡
- å¿˜è®°clearBatch()ï¼Œå†…å­˜æ³„æ¼
- ä¸ä½¿ç”¨äº‹åŠ¡ï¼Œæ•°æ®ä¸ä¸€è‡´

âœ… æ­£ç¡®åšæ³•ï¼š  
- åˆ†æ‰¹å¤„ç†ï¼Œæ¯æ‰¹1000-5000æ¡
- åŠæ—¶clearBatch()é‡Šæ”¾å†…å­˜
- åˆç†ä½¿ç”¨äº‹åŠ¡ä¿è¯åŸå­æ€§
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é€‰æ‹©ç­–ç•¥**
| æ•°æ®é‡ | **æ‰¹å¤„ç†å¤§å°** | **æ˜¯å¦åˆ†æ‰¹** | **æ¨èæ–¹æ¡ˆ** |
|--------|---------------|-------------|-------------|
| < 1000æ¡ | å…¨éƒ¨ä¸€æ‰¹ | å¦ | ç®€å•æ‰¹å¤„ç† |
| 1000-1ä¸‡æ¡ | 1000æ¡/æ‰¹ | æ˜¯ | **æ ‡å‡†æ–¹æ¡ˆ** |
| 1ä¸‡-10ä¸‡æ¡ | 5000æ¡/æ‰¹ | æ˜¯ | æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ |
| > 10ä¸‡æ¡ | 1ä¸‡æ¡/æ‰¹ | æ˜¯ | å¤§æ•°æ®å¤„ç†æ–¹æ¡ˆ |

**ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**
> ğŸ“ **æ‰¹å¤„ç†è®°å¿†æ³•**ï¼š
> - **è´­ç‰©è½¦æ¨¡å¼**ï¼šaddBatchåƒæ”¾å•†å“ï¼ŒexecuteBatchåƒç»“è´¦
> - **åˆ†æ‰¹å¤„ç†**ï¼šå¤§æ•°æ®åˆ†å°æ‰¹ï¼Œå†…å­˜å®‰å…¨æ•ˆç‡é«˜  
> - **äº‹åŠ¡ä¿æŠ¤**ï¼šè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å›æ»š

**âœ… å­¦ä¹ æ£€æŸ¥æ¸…å•**
- [ ] ç†è§£æ‰¹å¤„ç†çš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨
- [ ] æŒæ¡addBatch()å’ŒexecuteBatch()çš„ä½¿ç”¨
- [ ] èƒ½å¤Ÿå®ç°åˆ†æ‰¹å¤„ç†å¤§æ•°æ®é‡
- [ ] äº†è§£äº‹åŠ¡åœ¨æ‰¹å¤„ç†ä¸­çš„é‡è¦æ€§
- [ ] çŸ¥é“å¦‚ä½•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–å’Œå¼‚å¸¸å¤„ç†

**ğŸ”‘ å…³é”®ç†è§£**
æ‰¹å¤„ç†çš„æœ¬è´¨æ˜¯**å‡å°‘ç½‘ç»œäº¤äº’æ¬¡æ•°**ï¼Œå°±åƒç½‘è´­æ—¶æŠŠå¤šä¸ªå•†å“ä¸€èµ·ç»“è´¦ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªå•ç‹¬ä»˜æ¬¾ã€‚åˆç†ä½¿ç”¨æ‰¹å¤„ç†å¯ä»¥å¤§å¹…æå‡æ•°æ®åº“æ“ä½œçš„æ€§èƒ½ï¼Œæ˜¯JavaWebå¼€å‘ä¸­å¤„ç†å¤§é‡æ•°æ®çš„å¿…å¤‡æŠ€èƒ½ã€‚