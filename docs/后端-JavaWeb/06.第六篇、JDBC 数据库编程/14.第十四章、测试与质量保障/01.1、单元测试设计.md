---
title: 1ã€å•å…ƒæµ‹è¯•è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [å•å…ƒæµ‹è¯•åŸºç¡€æ¦‚å¿µ](#1-å•å…ƒæµ‹è¯•åŸºç¡€æ¦‚å¿µ)
2. [DAOå±‚æµ‹è¯•è®¾è®¡](#2-DAOå±‚æµ‹è¯•è®¾è®¡)
3. [æµ‹è¯•æ•°æ®å‡†å¤‡ç­–ç•¥](#3-æµ‹è¯•æ•°æ®å‡†å¤‡ç­–ç•¥)
4. [äº‹åŠ¡å›æ»šæµ‹è¯•](#4-äº‹åŠ¡å›æ»šæµ‹è¯•)
5. [Mockæ•°æ®æºåº”ç”¨](#5-Mockæ•°æ®æºåº”ç”¨)
6. [æµ‹è¯•è¦†ç›–ç‡åˆ†æ](#6-æµ‹è¯•è¦†ç›–ç‡åˆ†æ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ§ª å•å…ƒæµ‹è¯•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•


**ğŸ”¸ é€šä¿—ç†è§£**
å•å…ƒæµ‹è¯•å°±åƒæ˜¯ç»™æ¯ä¸ªä»£ç åŠŸèƒ½åš"ä½“æ£€"ã€‚å°±å¥½æ¯”æˆ‘ä»¬ä¹°äº†ä¸€å°æ–°æ‰‹æœºï¼Œè¦æµ‹è¯•æ¯ä¸ªåŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼š
- ğŸ“ é€šè¯åŠŸèƒ½èƒ½å¦æ­£å¸¸æ‹¨æ‰“
- ğŸ“± å±å¹•è§¦æ‘¸æ˜¯å¦çµæ•  
- ğŸ”‹ ç”µæ± å……ç”µæ˜¯å¦æ­£å¸¸

åœ¨JavaWebå¼€å‘ä¸­ï¼Œå•å…ƒæµ‹è¯•å°±æ˜¯æ£€æŸ¥æˆ‘ä»¬å†™çš„æ¯ä¸ªæ–¹æ³•ã€æ¯ä¸ªåŠŸèƒ½æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚

**ğŸ“‹ æ ¸å¿ƒå®šä¹‰**
```
å•å…ƒæµ‹è¯• = å¯¹ç¨‹åºä¸­æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥éªŒè¯
ç›®æ ‡ï¼šç¡®ä¿æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹è¿è¡Œæ­£ç¡®
èŒƒå›´ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªæ–¹æ³•æˆ–ä¸€ä¸ªç±»
ç‰¹ç‚¹ï¼šè‡ªåŠ¨åŒ–ã€å¯é‡å¤ã€å¿«é€Ÿæ‰§è¡Œ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å•å…ƒæµ‹è¯•


**ğŸ¯ å®é™…å¼€å‘åœºæ™¯å¯¹æ¯”**
```
æ²¡æœ‰æµ‹è¯•çš„å¼€å‘ï¼š
å¼€å‘å®Œæˆ â†’ æ‰‹åŠ¨æµ‹è¯• â†’ å‘ç°Bug â†’ ä¿®æ”¹ â†’ å†æ‰‹åŠ¨æµ‹è¯• â†’ ä¸Šçº¿
é—®é¢˜ï¼šè€—æ—¶é•¿ï¼Œå®¹æ˜“é—æ¼ï¼Œä¿®æ”¹åå¯èƒ½ç ´åå…¶ä»–åŠŸèƒ½

æœ‰å•å…ƒæµ‹è¯•çš„å¼€å‘ï¼š
å¼€å‘å®Œæˆ â†’ è¿è¡Œæµ‹è¯• â†’ è‡ªåŠ¨å‘ç°é—®é¢˜ â†’ ä¿®æ”¹ â†’ å†è¿è¡Œæµ‹è¯• â†’ ä¸Šçº¿
ä¼˜åŠ¿ï¼šå¿«é€Ÿåé¦ˆï¼Œå…¨é¢è¦†ç›–ï¼Œå›å½’æµ‹è¯•ç®€å•
```

**ğŸ’¡ æ ¸å¿ƒä»·å€¼**
- **ğŸ” bugå‘ç°**ï¼šåŠæ—©å‘ç°ä»£ç é—®é¢˜ï¼Œå‡å°‘åæœŸä¿®å¤æˆæœ¬
- **ğŸ“– ä»£ç æ–‡æ¡£**ï¼šæµ‹è¯•ç”¨ä¾‹å°±æ˜¯æœ€å¥½çš„ä½¿ç”¨è¯´æ˜ä¹¦
- **ğŸ›¡ï¸ é‡æ„ä¿éšœ**ï¼šä¿®æ”¹ä»£ç æ—¶ç¡®ä¿åŸæœ‰åŠŸèƒ½ä¸è¢«ç ´å
- **âš¡ å¼€å‘æ•ˆç‡**ï¼šå‡å°‘æ‰‹åŠ¨æµ‹è¯•æ—¶é—´ï¼Œæé«˜å¼€å‘é€Ÿåº¦

### 1.3 æµ‹è¯•æ¡†æ¶é€‰æ‹©


**ğŸ”§ ä¸»æµæµ‹è¯•æ¡†æ¶å¯¹æ¯”**

| æ¡†æ¶ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å­¦ä¹ éš¾åº¦** |
|------|---------|-------------|-------------|
| ğŸ¯ **JUnit 5** | `ç°ä»£åŒ–ï¼ŒåŠŸèƒ½ä¸°å¯Œ` | `æ–°é¡¹ç›®é¦–é€‰` | `ä¸­ç­‰` |
| ğŸ“š **JUnit 4** | `æˆç†Ÿç¨³å®šï¼Œä½¿ç”¨å¹¿æ³›` | `è€é¡¹ç›®ç»´æŠ¤` | `ç®€å•` |
| ğŸš€ **TestNG** | `çµæ´»é…ç½®ï¼Œå¼ºå¤§æ³¨è§£` | `å¤æ‚æµ‹è¯•åœºæ™¯` | `è¾ƒé«˜` |

**æ¨èé…ç½®**ï¼šå¯¹äºJavaWebé¡¹ç›®ï¼Œå»ºè®®ä½¿ç”¨JUnit 5 + Mavençš„ç»„åˆ

---

## 2. ğŸ—„ï¸ DAOå±‚æµ‹è¯•è®¾è®¡


### 2.1 DAOæµ‹è¯•çš„é‡è¦æ€§


**ğŸ”¸ DAOå±‚æ˜¯ä»€ä¹ˆ**
DAOï¼ˆData Access Objectï¼‰æ•°æ®è®¿é—®å¯¹è±¡ï¼Œç®€å•è¯´å°±æ˜¯ä¸“é—¨è´Ÿè´£ä¸æ•°æ®åº“"å¯¹è¯"çš„ä»£ç å±‚ã€‚

```
æƒ³è±¡ä¸€ä¸‹é¤å…çš„æœåŠ¡æµç¨‹ï¼š
é¡¾å®¢(ä¸šåŠ¡å±‚) â†’ æœåŠ¡å‘˜(DAOå±‚) â†’ å¨æˆ¿(æ•°æ®åº“)
æœåŠ¡å‘˜è´Ÿè´£ï¼šæ¥æ”¶ç‚¹é¤éœ€æ±‚ï¼Œä¼ è¾¾ç»™å¨æˆ¿ï¼Œè¿”å›åˆ¶ä½œç»“æœ

DAOå±‚èŒè´£ï¼š
- æ¥æ”¶ä¸šåŠ¡å±‚çš„æ•°æ®è¯·æ±‚
- è½¬æ¢ä¸ºSQLè¯­å¥æ‰§è¡Œ
- è¿”å›å¤„ç†ç»“æœç»™ä¸šåŠ¡å±‚
```

**âš ï¸ DAOæµ‹è¯•çš„æŒ‘æˆ˜**
- **æ•°æ®åº“ä¾èµ–**ï¼šéœ€è¦çœŸå®çš„æ•°æ®åº“è¿æ¥
- **æ•°æ®çŠ¶æ€**ï¼šæµ‹è¯•å¯èƒ½ä¼šå½±å“æ•°æ®åº“ä¸­çš„æ•°æ®
- **ç¯å¢ƒéš”ç¦»**ï¼šæµ‹è¯•æ•°æ®ä¸èƒ½å½±å“æ­£å¼æ•°æ®

### 2.2 æµ‹è¯•æ•°æ®åº“å‡†å¤‡


**ğŸ”§ æµ‹è¯•æ•°æ®åº“é…ç½®ç­–ç•¥**

**æ–¹æ¡ˆä¸€ï¼šä¸“ç”¨æµ‹è¯•æ•°æ®åº“**
```
ç”Ÿäº§æ•°æ®åº“ï¼šprod_db     (æ­£å¼æ•°æ®ï¼Œä¸èƒ½ç¢°)
å¼€å‘æ•°æ®åº“ï¼šdev_db      (å¼€å‘è°ƒè¯•ä½¿ç”¨)  
æµ‹è¯•æ•°æ®åº“ï¼štest_db     (ä¸“é—¨è·‘æµ‹è¯•ï¼Œå¯ä»¥éšä¾¿æ“ä½œ)

ä¼˜åŠ¿ï¼šå®Œå…¨éš”ç¦»ï¼Œå®‰å…¨å¯é 
ç¼ºç‚¹ï¼šéœ€è¦ç»´æŠ¤å¤šä¸ªæ•°æ®åº“
```

**æ–¹æ¡ˆäºŒï¼šå†…å­˜æ•°æ®åº“H2**
```java
// æµ‹è¯•é…ç½®æ–‡ä»¶ application-test.properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# H2ç‰¹ç‚¹ï¼š
# - çº¯Javaç¼–å†™ï¼Œå¯åŠ¨å¿«é€Ÿ
# - æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæµ‹è¯•ç»“æŸè‡ªåŠ¨æ¸…ç†  
# - æ”¯æŒå¤§éƒ¨åˆ†SQLæ ‡å‡†è¯­æ³•
# - éå¸¸é€‚åˆå•å…ƒæµ‹è¯•ä½¿ç”¨
```

### 2.3 DAOæµ‹è¯•å®æˆ˜ç¤ºä¾‹


**ğŸ“ ç”¨æˆ·DAOæµ‹è¯•è®¾è®¡**

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·ç®¡ç†çš„DAOç±»ï¼š

```java
// ç”¨æˆ·å®ä½“ç±»
public class User {
    private Long id;
    private String username;  
    private String email;
    private Date createTime;
    
    // æ„é€ æ–¹æ³•å’Œgetter/setterçœç•¥...
}

// ç”¨æˆ·DAOæ¥å£  
public interface UserDAO {
    void save(User user);           // ä¿å­˜ç”¨æˆ·
    User findById(Long id);         // æ ¹æ®IDæŸ¥æ‰¾
    List<User> findAll();          // æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·
    void update(User user);         // æ›´æ–°ç”¨æˆ·
    void deleteById(Long id);       // åˆ é™¤ç”¨æˆ·
}
```

**ğŸ§ª å®Œæ•´çš„DAOæµ‹è¯•ç±»**
```java
@ExtendWith(SpringExtension.class)  // ä½¿ç”¨Springæµ‹è¯•æ‰©å±•
@DataJpaTest                        // ä¸“é—¨æµ‹è¯•JPAå±‚
class UserDAOTest {
    
    @Autowired
    private UserDAO userDAO;
    
    private User testUser;
    
    @BeforeEach  // æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œå‰éƒ½ä¼šè¿è¡Œ
    void setUp() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        testUser = new User();
        testUser.setUsername("å¼ ä¸‰");
        testUser.setEmail("zhangsan@example.com");
        testUser.setCreateTime(new Date());
    }
    
    @Test
    @DisplayName("æµ‹è¯•ä¿å­˜ç”¨æˆ·åŠŸèƒ½")
    void testSaveUser() {
        // æ‰§è¡Œä¿å­˜æ“ä½œ
        userDAO.save(testUser);
        
        // éªŒè¯æ˜¯å¦ä¿å­˜æˆåŠŸ
        assertThat(testUser.getId()).isNotNull();
        System.out.println("âœ… ç”¨æˆ·ä¿å­˜æµ‹è¯•é€šè¿‡ï¼Œç”ŸæˆID: " + testUser.getId());
    }
    
    @Test  
    @DisplayName("æµ‹è¯•æ ¹æ®IDæŸ¥æ‰¾ç”¨æˆ·")
    void testFindById() {
        // å…ˆä¿å­˜ä¸€ä¸ªç”¨æˆ·
        userDAO.save(testUser);
        Long savedId = testUser.getId();
        
        // æ ¹æ®IDæŸ¥æ‰¾
        User found = userDAO.findById(savedId);
        
        // éªŒè¯æŸ¥æ‰¾ç»“æœ
        assertThat(found).isNotNull();
        assertThat(found.getUsername()).isEqualTo("å¼ ä¸‰");
        assertThat(found.getEmail()).isEqualTo("zhangsan@example.com");
        System.out.println("âœ… æ ¹æ®IDæŸ¥æ‰¾æµ‹è¯•é€šè¿‡");
    }
    
    @Test
    @DisplayName("æµ‹è¯•æŸ¥æ‰¾ä¸å­˜åœ¨çš„ç”¨æˆ·")  
    void testFindNonExistentUser() {
        // æŸ¥æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„ID
        User notFound = userDAO.findById(999L);
        
        // åº”è¯¥è¿”å›null
        assertThat(notFound).isNull();
        System.out.println("âœ… æŸ¥æ‰¾ä¸å­˜åœ¨ç”¨æˆ·æµ‹è¯•é€šè¿‡");
    }
}
```

**ğŸ’¡ æµ‹è¯•è¦ç‚¹è§£é‡Š**
- **@BeforeEach**ï¼šæ¯ä¸ªæµ‹è¯•æ–¹æ³•è¿è¡Œå‰éƒ½ä¼šæ‰§è¡Œï¼Œç¡®ä¿æµ‹è¯•æ•°æ®çš„ç‹¬ç«‹æ€§
- **@DisplayName**ï¼šç»™æµ‹è¯•æ–¹æ³•èµ·ä¸ªå¥½ç†è§£çš„ä¸­æ–‡åå­—
- **assertThat**ï¼šç”¨æ¥éªŒè¯ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ
- **æµ‹è¯•ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªæµ‹è¯•æ–¹æ³•éƒ½åº”è¯¥æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„ç»“æœ

---

## 3. ğŸ“Š æµ‹è¯•æ•°æ®å‡†å¤‡ç­–ç•¥


### 3.1 æµ‹è¯•æ•°æ®çš„æŒ‘æˆ˜


**ğŸ¤” å®é™…å¼€å‘ä¸­çš„å›°æ‰°**
```
é—®é¢˜åœºæ™¯ï¼š
- æµ‹è¯•éœ€è¦ç”¨æˆ·æ•°æ®ï¼Œä½†æ•°æ®åº“æ˜¯ç©ºçš„æ€ä¹ˆåŠï¼Ÿ
- ä¸åŒæµ‹è¯•éœ€è¦ä¸åŒçš„æ•°æ®çŠ¶æ€æ€ä¹ˆå¤„ç†ï¼Ÿ
- æµ‹è¯•å®Œæˆåï¼Œæµ‹è¯•æ•°æ®è¦ä¸è¦æ¸…ç†ï¼Ÿ
- å¦‚ä½•ä¿è¯æ¯æ¬¡æµ‹è¯•éƒ½æœ‰ä¸€è‡´çš„æ•°æ®ç¯å¢ƒï¼Ÿ
```

### 3.2 æµ‹è¯•æ•°æ®å‡†å¤‡æ–¹æ³•


**ğŸ“‹ æ–¹æ³•ä¸€ï¼š@Sqlæ³¨è§£å‡†å¤‡æ•°æ®**

```java
@Test
@Sql("/test-data/users.sql")  // æ‰§è¡ŒSQLè„šæœ¬å‡†å¤‡æ•°æ®
@DisplayName("æµ‹è¯•ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢")
void testFindAllUsers() {
    List<User> users = userDAO.findAll();
    assertThat(users).hasSize(3);  // éªŒè¯æŸ¥è¯¢åˆ°3ä¸ªç”¨æˆ·
}
```

**ğŸ“„ å¯¹åº”çš„SQLæ–‡ä»¶ (test-data/users.sql)**
```sql
-- æ’å…¥æµ‹è¯•ç”¨æˆ·æ•°æ®
INSERT INTO users (username, email, create_time) VALUES 
('å¼ ä¸‰', 'zhangsan@test.com', '2024-01-01'),
('æå››', 'lisi@test.com', '2024-01-02'),  
('ç‹äº”', 'wangwu@test.com', '2024-01-03');
```

**ğŸ“‹ æ–¹æ³•äºŒï¼šä»£ç ä¸­åŠ¨æ€å‡†å¤‡æ•°æ®**

```java
@Test
@DisplayName("æµ‹è¯•ç”¨æˆ·æ•°é‡ç»Ÿè®¡")
void testUserCount() {
    // å‡†å¤‡æµ‹è¯•æ•°æ® - å…ˆæ¸…ç†ï¼Œå†æ’å…¥
    userDAO.deleteAll();  // æ¸…ç©ºè¡¨
    
    // æ’å…¥3ä¸ªæµ‹è¯•ç”¨æˆ·
    for (int i = 1; i <= 3; i++) {
        User user = new User();
        user.setUsername("æµ‹è¯•ç”¨æˆ·" + i);
        user.setEmail("test" + i + "@example.com");
        userDAO.save(user);
    }
    
    // æ‰§è¡Œæµ‹è¯•
    long count = userDAO.count();
    
    // éªŒè¯ç»“æœ
    assertThat(count).isEqualTo(3);
    System.out.println("âœ… ç”¨æˆ·æ•°é‡ç»Ÿè®¡æµ‹è¯•é€šè¿‡ï¼Œå…±æœ‰" + count + "ä¸ªç”¨æˆ·");
}
```

**ğŸ“‹ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨TestDataBuilderæ¨¡å¼**

```java
// æµ‹è¯•æ•°æ®æ„å»ºå™¨
public class UserTestDataBuilder {
    private User user = new User();
    
    public static UserTestDataBuilder aUser() {
        return new UserTestDataBuilder();
    }
    
    public UserTestDataBuilder withUsername(String username) {
        user.setUsername(username);
        return this;
    }
    
    public UserTestDataBuilder withEmail(String email) {
        user.setEmail(email);
        return this;
    }
    
    public UserTestDataBuilder withCreateTime(Date createTime) {
        user.setCreateTime(createTime);
        return this;
    }
    
    public User build() {
        if (user.getCreateTime() == null) {
            user.setCreateTime(new Date());  // é»˜è®¤å½“å‰æ—¶é—´
        }
        return user;
    }
}

// åœ¨æµ‹è¯•ä¸­ä½¿ç”¨
@Test
@DisplayName("æµ‹è¯•é‚®ç®±é‡å¤æ£€æŸ¥")
void testDuplicateEmail() {
    // ä½¿ç”¨æ„å»ºå™¨åˆ›å»ºæµ‹è¯•æ•°æ® - ä»£ç æ›´æ¸…æ™°
    User user1 = UserTestDataBuilder.aUser()
        .withUsername("ç”¨æˆ·1")
        .withEmail("same@email.com")
        .build();
        
    User user2 = UserTestDataBuilder.aUser()  
        .withUsername("ç”¨æˆ·2")
        .withEmail("same@email.com")  // ç›¸åŒé‚®ç®±
        .build();
    
    userDAO.save(user1);
    
    // å°è¯•ä¿å­˜ç›¸åŒé‚®ç®±çš„ç”¨æˆ·ï¼Œåº”è¯¥æŠ›å‡ºå¼‚å¸¸
    assertThrows(DataIntegrityViolationException.class, () -> {
        userDAO.save(user2);
    });
}
```

---

## 4. ğŸ”„ äº‹åŠ¡å›æ»šæµ‹è¯•


### 4.1 äº‹åŠ¡å›æ»šçš„å¿…è¦æ€§


**ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡å›æ»š**
```
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
ä½ åœ¨æµ‹è¯•è½¬è´¦åŠŸèƒ½ï¼š
1. Aè´¦æˆ·å‡å°‘100å…ƒ
2. Bè´¦æˆ·å¢åŠ 100å…ƒ  
3. æµ‹è¯•é€šè¿‡äº†

ä½†æ˜¯æµ‹è¯•æ•°æ®è¿˜ç•™åœ¨æ•°æ®åº“ä¸­ï¼
ä¸‹æ¬¡è¿è¡Œæµ‹è¯•æ—¶ï¼ŒAè´¦æˆ·åˆå‡å°‘100å…ƒ...

é—®é¢˜ï¼šæµ‹è¯•æ•°æ®æ±¡æŸ“äº†æ•°æ®åº“ï¼Œå½±å“åç»­æµ‹è¯•
è§£å†³ï¼šä½¿ç”¨äº‹åŠ¡å›æ»šï¼Œæµ‹è¯•å®Œè‡ªåŠ¨æ¢å¤åŸçŠ¶
```

### 4.2 Spring Testäº‹åŠ¡ç®¡ç†


**ğŸ”§ è‡ªåŠ¨å›æ»šé…ç½®**

```java
@ExtendWith(SpringExtension.class)
@DataJpaTest  // è¿™ä¸ªæ³¨è§£é»˜è®¤å¼€å¯äº‹åŠ¡å›æ»š
@Transactional  // æ˜ç¡®æ ‡æ˜äº‹åŠ¡è¾¹ç•Œ
class TransactionTest {
    
    @Autowired
    private AccountDAO accountDAO;
    
    @Test
    @DisplayName("æµ‹è¯•è½¬è´¦åŠŸèƒ½ - è‡ªåŠ¨å›æ»š")
    void testTransfer() {
        // å‡†å¤‡åˆå§‹æ•°æ®
        Account accountA = new Account("Aè´¦æˆ·", 1000.0);
        Account accountB = new Account("Bè´¦æˆ·", 500.0);  
        accountDAO.save(accountA);
        accountDAO.save(accountB);
        
        // è®°å½•åˆå§‹ä½™é¢
        double initialBalanceA = accountA.getBalance();
        double initialBalanceB = accountB.getBalance();
        
        // æ‰§è¡Œè½¬è´¦
        transferService.transfer(accountA.getId(), accountB.getId(), 100.0);
        
        // éªŒè¯è½¬è´¦ç»“æœ
        Account updatedA = accountDAO.findById(accountA.getId());
        Account updatedB = accountDAO.findById(accountB.getId());
        
        assertThat(updatedA.getBalance()).isEqualTo(900.0);
        assertThat(updatedB.getBalance()).isEqualTo(600.0);
        
        System.out.println("âœ… è½¬è´¦åŠŸèƒ½æµ‹è¯•é€šè¿‡");
        // æµ‹è¯•æ–¹æ³•ç»“æŸåï¼Œäº‹åŠ¡è‡ªåŠ¨å›æ»šï¼Œæ•°æ®æ¢å¤åŸçŠ¶
    }
    
    @Test
    @DisplayName("éªŒè¯äº‹åŠ¡å›æ»šæ•ˆæœ")
    void testRollbackEffect() {
        // è¿™ä¸ªæµ‹è¯•éªŒè¯ä¸Šä¸€ä¸ªæµ‹è¯•çš„æ•°æ®å·²ç»å›æ»š
        long accountCount = accountDAO.count();
        assertThat(accountCount).isEqualTo(0);  // åº”è¯¥æ²¡æœ‰ä»»ä½•è´¦æˆ·æ•°æ®
        System.out.println("âœ… äº‹åŠ¡å›æ»šéªŒè¯é€šè¿‡ï¼Œæ•°æ®å·²æ¸…ç†");
    }
}
```

**ğŸ“‹ æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡å›æ»š**

```java
@Test
@DisplayName("æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡å›æ»š")
@Rollback(false)  // å…³é—­è‡ªåŠ¨å›æ»š
void testWithoutRollback() {
    User user = new User("æ°¸ä¹…ç”¨æˆ·", "permanent@test.com");
    userDAO.save(user);
    
    // è¿™ä¸ªç”¨æˆ·ä¼šçœŸæ­£ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œä¸ä¼šå›æ»š
    System.out.println("âš ï¸ æ³¨æ„ï¼šè¿™æ¡æ•°æ®ä¸ä¼šå›æ»šï¼Œä¼šä¿ç•™åœ¨æ•°æ®åº“ä¸­");
}

@Test  
@DisplayName("æ¡ä»¶æ€§å›æ»š")
void testConditionalRollback() {
    try {
        // æ‰§è¡Œå¯èƒ½å¤±è´¥çš„æ“ä½œ
        riskyOperation();
        
        // å¦‚æœæ“ä½œæˆåŠŸï¼Œæ‰‹åŠ¨æ ‡è®°å›æ»š
        TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
        
    } catch (Exception e) {
        // å¼‚å¸¸æƒ…å†µè‡ªåŠ¨å›æ»š
        System.out.println("æ“ä½œå¤±è´¥ï¼Œäº‹åŠ¡å°†å›æ»š: " + e.getMessage());
    }
}
```

### 4.3 äº‹åŠ¡æµ‹è¯•æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**
```java
@TestMethodOrder(OrderAnnotation.class)  // æ§åˆ¶æµ‹è¯•æ‰§è¡Œé¡ºåº
class TransactionBestPractice {
    
    @Test
    @Order(1)
    @DisplayName("å‡†å¤‡åŸºç¡€æ•°æ®")
    void setupBaseData() {
        // å‡†å¤‡æ‰€æœ‰æµ‹è¯•éœ€è¦çš„åŸºç¡€æ•°æ®
    }
    
    @Test
    @Order(2) 
    @DisplayName("æµ‹è¯•æ­£å¸¸ä¸šåŠ¡æµç¨‹")
    void testNormalFlow() {
        // æµ‹è¯•æ­£å¸¸æƒ…å†µ
    }
    
    @Test
    @Order(3)
    @DisplayName("æµ‹è¯•å¼‚å¸¸å¤„ç†")  
    void testExceptionHandling() {
        // æµ‹è¯•å¼‚å¸¸æƒ…å†µ
    }
    
    @AfterEach
    void cleanUp() {
        // æ¯ä¸ªæµ‹è¯•åè¿›è¡Œå¿…è¦çš„æ¸…ç†
        // æ³¨æ„ï¼šå¦‚æœä½¿ç”¨@Transactionalï¼Œè¿™é‡Œçš„æ¸…ç†ä¹Ÿä¼šè¢«å›æ»š
    }
}
```

---

## 5. ğŸ­ Mockæ•°æ®æºåº”ç”¨


### 5.1 ä»€ä¹ˆæ˜¯Mockæµ‹è¯•


**ğŸ”¸ é€šä¿—ç†è§£Mock**
Mockå°±åƒæ˜¯"æ¼”æˆç”¨çš„é“å…·"ã€‚åœ¨ç”µå½±ä¸­ï¼š
- ğŸ¬ çœŸæªå¤ªå±é™© â†’ ç”¨é“å…·æªæ›¿ä»£
- ğŸ  çœŸæˆ¿å­å¤ªè´µ â†’ ç”¨å¸ƒæ™¯æ›¿ä»£  
- ğŸ’¥ çœŸçˆ†ç‚¸å¤ªå±é™© â†’ ç”¨ç‰¹æ•ˆæ›¿ä»£

åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼š
- ğŸ—„ï¸ çœŸæ•°æ®åº“å¤ªæ…¢ â†’ ç”¨Mockæ•°æ®æºæ›¿ä»£
- ğŸŒ çœŸAPIä¸ç¨³å®š â†’ ç”¨MockæœåŠ¡æ›¿ä»£
- ğŸ’³ çœŸæ”¯ä»˜å¤ªå±é™© â†’ ç”¨Mockæ”¯ä»˜æ›¿ä»£

**ğŸ“‹ Mockçš„æ ¸å¿ƒä»·å€¼**
```
é€Ÿåº¦å¿«ï¼šä¸éœ€è¦çœŸå®çš„æ•°æ®åº“è¿æ¥
å¯æ§åˆ¶ï¼šå¯ä»¥ç²¾ç¡®æ§åˆ¶è¿”å›çš„æ•°æ®
å¯é¢„æµ‹ï¼šæ¯æ¬¡æµ‹è¯•ç»“æœéƒ½ä¸€è‡´
å®‰å…¨æ€§ï¼šä¸ä¼šå½±å“çœŸå®çš„ç³»ç»Ÿ
```

### 5.2 Mockitoæ¡†æ¶ä½¿ç”¨


**ğŸ”§ Mock DAOå±‚ç¤ºä¾‹**

```java
@ExtendWith(MockitoExtension.class)  // ä½¿ç”¨Mockitoæ‰©å±•
class UserServiceTest {
    
    @Mock
    private UserDAO userDAO;  // Mockçš„DAOå¯¹è±¡
    
    @InjectMocks  
    private UserService userService;  // è¢«æµ‹è¯•çš„æœåŠ¡ï¼Œè‡ªåŠ¨æ³¨å…¥Mockå¯¹è±¡
    
    @Test
    @DisplayName("æµ‹è¯•æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·")
    void testFindByUsername() {
        // å‡†å¤‡Mockæ•°æ®
        User mockUser = new User();
        mockUser.setId(1L);
        mockUser.setUsername("å¼ ä¸‰");
        mockUser.setEmail("zhangsan@test.com");
        
        // è®¾ç½®Mockè¡Œä¸ºï¼šå½“è°ƒç”¨findByUsernameæ—¶è¿”å›mockUser
        when(userDAO.findByUsername("å¼ ä¸‰")).thenReturn(mockUser);
        
        // æ‰§è¡Œè¢«æµ‹è¯•çš„æ–¹æ³•
        User result = userService.getUserByUsername("å¼ ä¸‰");
        
        // éªŒè¯ç»“æœ
        assertThat(result).isNotNull();
        assertThat(result.getUsername()).isEqualTo("å¼ ä¸‰");
        assertThat(result.getEmail()).isEqualTo("zhangsan@test.com");
        
        // éªŒè¯Mockæ–¹æ³•è¢«æ­£ç¡®è°ƒç”¨
        verify(userDAO).findByUsername("å¼ ä¸‰");
        System.out.println("âœ… Mockæµ‹è¯•é€šè¿‡ï¼Œç”¨æˆ·æœåŠ¡æ­£å¸¸å·¥ä½œ");
    }
    
    @Test
    @DisplayName("æµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨çš„æƒ…å†µ")
    void testUserNotFound() {
        // è®¾ç½®Mockè¡Œä¸ºï¼šè¿”å›nullè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨
        when(userDAO.findByUsername("ä¸å­˜åœ¨çš„ç”¨æˆ·")).thenReturn(null);
        
        // æ‰§è¡Œæµ‹è¯•
        User result = userService.getUserByUsername("ä¸å­˜åœ¨çš„ç”¨æˆ·");
        
        // éªŒè¯ç»“æœ
        assertThat(result).isNull();
        System.out.println("âœ… ç”¨æˆ·ä¸å­˜åœ¨æƒ…å†µæµ‹è¯•é€šè¿‡");
    }
}
```

**ğŸ”§ Mockæ•°æ®æºè¿æ¥**

```java
@ExtendWith(MockitoExtension.class)
class DatabaseConnectionTest {
    
    @Mock
    private DataSource dataSource;
    
    @Mock  
    private Connection connection;
    
    @Mock
    private PreparedStatement preparedStatement;
    
    @Mock
    private ResultSet resultSet;
    
    @Test
    @DisplayName("Mockå®Œæ•´çš„æ•°æ®åº“æ“ä½œ")
    void testMockDatabase() throws SQLException {
        // è®¾ç½®Mocké“¾ï¼šDataSource â†’ Connection â†’ PreparedStatement â†’ ResultSet
        when(dataSource.getConnection()).thenReturn(connection);
        when(connection.prepareStatement(anyString())).thenReturn(preparedStatement);
        when(preparedStatement.executeQuery()).thenReturn(resultSet);
        
        // è®¾ç½®ResultSetçš„è¿”å›å€¼
        when(resultSet.next()).thenReturn(true, false);  // ç¬¬ä¸€æ¬¡trueï¼Œç¬¬äºŒæ¬¡false
        when(resultSet.getLong("id")).thenReturn(1L);
        when(resultSet.getString("username")).thenReturn("Mockç”¨æˆ·");
        when(resultSet.getString("email")).thenReturn("mock@test.com");
        
        // æ‰§è¡Œå®é™…çš„DAOæ–¹æ³•ï¼ˆè¿™é‡Œç®€åŒ–å±•ç¤ºï¼‰
        User user = executeQuery();
        
        // éªŒè¯ç»“æœ
        assertThat(user.getId()).isEqualTo(1L);
        assertThat(user.getUsername()).isEqualTo("Mockç”¨æˆ·");
        
        // éªŒè¯è°ƒç”¨æ¬¡æ•°
        verify(dataSource, times(1)).getConnection();
        verify(connection, times(1)).prepareStatement(anyString());
        System.out.println("âœ… Mockæ•°æ®åº“æ“ä½œæµ‹è¯•é€šè¿‡");
    }
    
    private User executeQuery() throws SQLException {
        // æ¨¡æ‹ŸDAOä¸­çš„æŸ¥è¯¢é€»è¾‘
        Connection conn = dataSource.getConnection();
        PreparedStatement ps = conn.prepareStatement("SELECT * FROM users WHERE id = ?");
        ps.setLong(1, 1L);
        ResultSet rs = ps.executeQuery();
        
        if (rs.next()) {
            User user = new User();
            user.setId(rs.getLong("id"));
            user.setUsername(rs.getString("username"));
            user.setEmail(rs.getString("email"));
            return user;
        }
        return null;
    }
}
```

### 5.3 Mock vs çœŸå®æ•°æ®åº“å¯¹æ¯”


**âš–ï¸ é€‰æ‹©æŒ‡å—**

| æµ‹è¯•ç±»å‹ | **ä½¿ç”¨Mock** | **ä½¿ç”¨çœŸå®DB** | **æ¨èåœºæ™¯** |
|---------|-------------|---------------|-------------|
| ğŸš€ **å•å…ƒæµ‹è¯•** | `âœ… æ¨è` | `âŒ ä¸æ¨è` | `æµ‹è¯•ä¸šåŠ¡é€»è¾‘` |
| ğŸ”— **é›†æˆæµ‹è¯•** | `âŒ ä¸åˆé€‚` | `âœ… å¿…é¡»` | `æµ‹è¯•æ•°æ®è®¿é—®` |
| ğŸ¯ **åŠŸèƒ½æµ‹è¯•** | `âŒ ä¸åˆé€‚` | `âœ… å¿…é¡»` | `ç«¯åˆ°ç«¯éªŒè¯` |

**ğŸ’¡ å®è·µå»ºè®®**
```
Mocké€‚ç”¨åœºæ™¯ï¼š
âœ… æµ‹è¯•ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§
âœ… æµ‹è¯•å¼‚å¸¸å¤„ç†æœºåˆ¶  
âœ… å¿«é€Ÿåé¦ˆå¼€å‘é—®é¢˜
âœ… ä¸ä¾èµ–å¤–éƒ¨ç¯å¢ƒ

çœŸå®æ•°æ®åº“é€‚ç”¨åœºæ™¯ï¼š
âœ… éªŒè¯SQLè¯­å¥æ­£ç¡®æ€§
âœ… æµ‹è¯•äº‹åŠ¡å¤„ç†
âœ… éªŒè¯æ•°æ®çº¦æŸ
âœ… æ€§èƒ½æµ‹è¯•
```

---

## 6. ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡åˆ†æ


### 6.1 ä»€ä¹ˆæ˜¯æµ‹è¯•è¦†ç›–ç‡


**ğŸ”¸ é€šä¿—ç†è§£è¦†ç›–ç‡**
æµ‹è¯•è¦†ç›–ç‡å°±åƒæ˜¯"ä½“æ£€æŠ¥å‘Šçš„å®Œæ•´ç¨‹åº¦"ï¼š
- ğŸ“Š **50%è¦†ç›–ç‡**ï¼šåªæ£€æŸ¥äº†ä¸€åŠçš„èº«ä½“éƒ¨ä½
- ğŸ“Š **80%è¦†ç›–ç‡**ï¼šæ£€æŸ¥äº†å¤§éƒ¨åˆ†é‡è¦å™¨å®˜
- ğŸ“Š **95%è¦†ç›–ç‡**ï¼šå‡ ä¹å…¨èº«éƒ½æ£€æŸ¥äº†

åœ¨ä»£ç æµ‹è¯•ä¸­ï¼š
- ğŸ“Š **è¡Œè¦†ç›–ç‡**ï¼šæµ‹è¯•æ‰§è¡Œäº†å¤šå°‘è¡Œä»£ç 
- ğŸ“Š **åˆ†æ”¯è¦†ç›–ç‡**ï¼šæµ‹è¯•äº†å¤šå°‘ä¸ªif/elseåˆ†æ”¯
- ğŸ“Š **æ–¹æ³•è¦†ç›–ç‡**ï¼šæµ‹è¯•äº†å¤šå°‘ä¸ªæ–¹æ³•

### 6.2 JaCoCoè¦†ç›–ç‡å·¥å…·é…ç½®


**ğŸ”§ Mavené…ç½®**

```xml
<!-- pom.xmlä¸­æ·»åŠ JaCoCoæ’ä»¶ -->
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.7</version>
    <executions>
        <!-- å‡†å¤‡è¦†ç›–ç‡ä»£ç† -->
        <execution>
            <goals>
                <goal>prepare-agent</goal>
            </goals>
        </execution>
        <!-- ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š -->
        <execution>
            <id>report</id>
            <phase>test</phase>
            <goals>
                <goal>report</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

**ğŸš€ è¿è¡Œè¦†ç›–ç‡åˆ†æ**
```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn clean test

# æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
# æŠ¥å‘Šä½ç½®ï¼štarget/site/jacoco/index.html
# ç”¨æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å°±èƒ½çœ‹åˆ°è¯¦ç»†çš„è¦†ç›–ç‡åˆ†æ
```

### 6.3 è¦†ç›–ç‡æŠ¥å‘Šè§£è¯»


**ğŸ“Š è¦†ç›–ç‡æŒ‡æ ‡è¯´æ˜**

```
è¦†ç›–ç‡æŠ¥å‘Šç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è¦†ç›–ç‡ç»Ÿè®¡                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŒ‡ä»¤è¦†ç›–ç‡    â”‚ 85% (425/500)           â”‚
â”‚ åˆ†æ”¯è¦†ç›–ç‡    â”‚ 78% (39/50)             â”‚  
â”‚ è¡Œè¦†ç›–ç‡      â”‚ 82% (164/200)           â”‚
â”‚ æ–¹æ³•è¦†ç›–ç‡    â”‚ 90% (18/20)             â”‚
â”‚ ç±»è¦†ç›–ç‡      â”‚ 100% (5/5)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è§£è¯»è¯´æ˜ï¼š
ğŸ” æŒ‡ä»¤è¦†ç›–ç‡ 85%ï¼šå­—èŠ‚ç æŒ‡ä»¤æ‰§è¡Œäº†85%
ğŸ” åˆ†æ”¯è¦†ç›–ç‡ 78%ï¼šif/elseåˆ†æ”¯æµ‹è¯•äº†78%  
ğŸ” è¡Œè¦†ç›–ç‡ 82%ï¼šä»£ç è¡Œæ‰§è¡Œäº†82%
ğŸ” æ–¹æ³•è¦†ç›–ç‡ 90%ï¼šæ–¹æ³•è°ƒç”¨äº†90%
ğŸ” ç±»è¦†ç›–ç‡ 100%ï¼šæ‰€æœ‰ç±»éƒ½æœ‰æµ‹è¯•è¦†ç›–
```

**ğŸ¯ è¦†ç›–ç‡ç›®æ ‡è®¾å®š**

| é¡¹ç›®ç±»å‹ | **æ¨èè¦†ç›–ç‡** | **è¯´æ˜** |
|---------|---------------|---------|
| ğŸ¢ **ä¼ä¸šçº§é¡¹ç›®** | `80%ä»¥ä¸Š` | `è´¨é‡è¦æ±‚é«˜ï¼Œéœ€è¦å……åˆ†æµ‹è¯•` |
| ğŸš€ **åˆ›ä¸šé¡¹ç›®** | `60-70%` | `å¿«é€Ÿè¿­ä»£ï¼Œæ ¸å¿ƒåŠŸèƒ½è¦†ç›–` |
| ğŸ“š **å­¦ä¹ é¡¹ç›®** | `50%ä»¥ä¸Š` | `ç»ƒä¹ ä¸ºä¸»ï¼Œäº†è§£æµ‹è¯•æ–¹æ³•` |

**âš ï¸ è¦†ç›–ç‡è¯¯åŒº**
```
âŒ é”™è¯¯è®¤è¯†ï¼š"è¦†ç›–ç‡è¶Šé«˜è¶Šå¥½"
âœ… æ­£ç¡®è®¤è¯†ï¼š"æœ‰æ„ä¹‰çš„è¦†ç›–æ‰æ˜¯å¥½è¦†ç›–"

âŒ æ— æ„ä¹‰çš„é«˜è¦†ç›–ç‡ï¼š
- åªæµ‹è¯•getter/setteræ–¹æ³•
- æµ‹è¯•ç”¨ä¾‹åªæ‰§è¡Œä»£ç ä¸éªŒè¯ç»“æœ  
- ä¸ºäº†è¦†ç›–ç‡è€Œå†™æ— ç”¨æµ‹è¯•

âœ… æœ‰æ„ä¹‰çš„è¦†ç›–ç‡ï¼š
- æµ‹è¯•æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- éªŒè¯å¼‚å¸¸å¤„ç†æœºåˆ¶
- è¦†ç›–é‡è¦çš„è¾¹ç•Œæ¡ä»¶
```

### 6.4 æå‡è¦†ç›–ç‡çš„ç­–ç•¥


**ğŸ¯ è¯†åˆ«æœªè¦†ç›–ä»£ç **

```java
public class UserService {
    
    public User createUser(String username, String email) {
        // è¿™ä¸ªåˆ†æ”¯å¯èƒ½æ²¡æœ‰è¢«æµ‹è¯•è¦†ç›–
        if (username == null || username.trim().isEmpty()) {
            throw new IllegalArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
        }
        
        // è¿™ä¸ªåˆ†æ”¯ä¹Ÿå¯èƒ½æ²¡æœ‰è¢«æµ‹è¯•è¦†ç›–  
        if (email == null || !email.contains("@")) {
            throw new IllegalArgumentException("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
        }
        
        User user = new User();
        user.setUsername(username.trim());
        user.setEmail(email.toLowerCase());
        
        return userDAO.save(user);
    }
}

// é’ˆå¯¹æ€§è¡¥å……æµ‹è¯•ç”¨ä¾‹
@Test
@DisplayName("æµ‹è¯•ç”¨æˆ·åä¸ºç©ºçš„æƒ…å†µ")
void testCreateUserWithEmptyUsername() {
    // æµ‹è¯•usernameä¸ºnullçš„åˆ†æ”¯
    assertThrows(IllegalArgumentException.class, () -> {
        userService.createUser(null, "test@example.com");
    });
    
    // æµ‹è¯•usernameä¸ºç©ºå­—ç¬¦ä¸²çš„åˆ†æ”¯
    assertThrows(IllegalArgumentException.class, () -> {
        userService.createUser("   ", "test@example.com");
    });
}

@Test  
@DisplayName("æµ‹è¯•é‚®ç®±æ ¼å¼é”™è¯¯çš„æƒ…å†µ")
void testCreateUserWithInvalidEmail() {
    // æµ‹è¯•emailä¸ºnullçš„åˆ†æ”¯
    assertThrows(IllegalArgumentException.class, () -> {
        userService.createUser("å¼ ä¸‰", null);
    });
    
    // æµ‹è¯•emailæ ¼å¼é”™è¯¯çš„åˆ†æ”¯
    assertThrows(IllegalArgumentException.class, () -> {
        userService.createUser("å¼ ä¸‰", "invalid-email");
    });
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å•å…ƒæµ‹è¯•æœ¬è´¨ï¼šå¯¹æœ€å°åŠŸèƒ½å•å…ƒè¿›è¡Œè‡ªåŠ¨åŒ–éªŒè¯
ğŸ”¸ DAOå±‚æµ‹è¯•ï¼šä¸“é—¨æµ‹è¯•æ•°æ®è®¿é—®å±‚çš„åŠŸèƒ½æ­£ç¡®æ€§  
ğŸ”¸ æµ‹è¯•æ•°æ®å‡†å¤‡ï¼šä¸ºæµ‹è¯•æä¾›å¿…è¦çš„åˆå§‹æ•°æ®ç¯å¢ƒ
ğŸ”¸ äº‹åŠ¡å›æ»šï¼šæµ‹è¯•åè‡ªåŠ¨æ¸…ç†æ•°æ®ï¼Œä¿æŒç¯å¢ƒçº¯å‡€
ğŸ”¸ MockæŠ€æœ¯ï¼šç”¨æ¨¡æ‹Ÿå¯¹è±¡æ›¿ä»£çœŸå®ä¾èµ–ï¼Œæé«˜æµ‹è¯•æ•ˆç‡
ğŸ”¸ è¦†ç›–ç‡åˆ†æï¼šè¡¡é‡æµ‹è¯•å®Œæ•´æ€§çš„é‡è¦æŒ‡æ ‡
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦åšå•å…ƒæµ‹è¯•**
```
å¼€å‘æ•ˆç‡ï¼š
- å¿«é€Ÿå‘ç°é—®é¢˜ï¼Œå‡å°‘debugæ—¶é—´
- è‡ªåŠ¨åŒ–æ‰§è¡Œï¼ŒèŠ‚çœæ‰‹åŠ¨æµ‹è¯•å·¥ä½œ  
- å›å½’æµ‹è¯•ç®€å•ï¼Œä¿®æ”¹åå¿«é€ŸéªŒè¯

ä»£ç è´¨é‡ï¼š
- å¼ºåˆ¶æ€è€ƒè¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†
- æµ‹è¯•å³æ–‡æ¡£ï¼Œè¯´æ˜ä»£ç å¦‚ä½•ä½¿ç”¨
- æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§
```

**ğŸ”¹ DAOå±‚æµ‹è¯•çš„ç‰¹æ®Šæ€§**
```
æ•°æ®åº“ä¾èµ–ï¼š
- éœ€è¦çœŸå®æˆ–æ¨¡æ‹Ÿçš„æ•°æ®åº“ç¯å¢ƒ
- æµ‹è¯•æ•°æ®çš„å‡†å¤‡å’Œæ¸…ç†æ˜¯å…³é”®
- äº‹åŠ¡ç®¡ç†å½±å“æµ‹è¯•çš„ç‹¬ç«‹æ€§

æµ‹è¯•ç­–ç•¥ï¼š
- ç®€å•æŸ¥è¯¢ï¼šä½¿ç”¨å†…å­˜æ•°æ®åº“H2
- å¤æ‚ä¸šåŠ¡ï¼šä½¿ç”¨ä¸“ç”¨æµ‹è¯•æ•°æ®åº“  
- æ€§èƒ½æµ‹è¯•ï¼šå¿…é¡»ä½¿ç”¨çœŸå®æ•°æ®åº“
```

**ğŸ”¹ MockæŠ€æœ¯çš„é€‚ç”¨åœºæ™¯**
```
é€‚åˆMockï¼š
- æµ‹è¯•ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§
- å¤–éƒ¨ä¾èµ–ä¸ç¨³å®šæˆ–æˆæœ¬é«˜
- éœ€è¦æ¨¡æ‹Ÿå¼‚å¸¸æƒ…å†µ
- å•å…ƒæµ‹è¯•çš„éš”ç¦»æ€§è¦æ±‚

ä¸é€‚åˆMockï¼š  
- æµ‹è¯•æ•°æ®è®¿é—®å±‚æœ¬èº«
- éªŒè¯SQLè¯­å¥æ­£ç¡®æ€§
- é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•
- æ€§èƒ½å’Œå‹åŠ›æµ‹è¯•
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æµ‹è¯•ç­–ç•¥é€‰æ‹©**
```
é¡¹ç›®åˆæœŸï¼š
âœ… é‡ç‚¹æµ‹è¯•æ ¸å¿ƒä¸šåŠ¡é€»è¾‘  
âœ… ä½¿ç”¨MockåŠ å¿«æµ‹è¯•æ‰§è¡Œ
âœ… å»ºç«‹åŸºæœ¬çš„æµ‹è¯•æ¡†æ¶

é¡¹ç›®æˆç†ŸæœŸï¼š
âœ… æé«˜æµ‹è¯•è¦†ç›–ç‡åˆ°80%ä»¥ä¸Š
âœ… å¢åŠ é›†æˆæµ‹è¯•éªŒè¯ç«¯åˆ°ç«¯æµç¨‹
âœ… å»ºç«‹å®Œå–„çš„æµ‹è¯•æ•°æ®ç®¡ç†

é¡¹ç›®ç»´æŠ¤æœŸï¼š
âœ… é‡ç‚¹æµ‹è¯•ä¿®æ”¹å’Œæ–°å¢åŠŸèƒ½
âœ… ä¿æŒæµ‹è¯•å¥—ä»¶çš„è¿è¡Œç¨³å®šæ€§
âœ… å®šæœŸreviewå’Œä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹
```

**ğŸ”§ æµ‹è¯•ç¯å¢ƒæ­å»º**
```
å¼€å‘ç¯å¢ƒï¼š
- ä½¿ç”¨å†…å­˜æ•°æ®åº“H2è¿›è¡Œå¿«é€Ÿæµ‹è¯•
- é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œ
- é›†æˆè¦†ç›–ç‡åˆ†æå·¥å…·

æŒç»­é›†æˆï¼š
- æ¯æ¬¡ä»£ç æäº¤éƒ½è¿è¡Œæµ‹è¯•å¥—ä»¶
- æµ‹è¯•å¤±è´¥é˜»æ­¢ä»£ç åˆå¹¶
- ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šå’Œè¦†ç›–ç‡æŠ¥å‘Š

ç”Ÿäº§éªŒè¯ï¼š
- ä½¿ç”¨ä¸ç”Ÿäº§ç¯å¢ƒç›¸ä¼¼çš„æµ‹è¯•ç¯å¢ƒ
- è¿›è¡Œå®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•
- æ€§èƒ½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•
```

### 7.4 å¸¸è§é—®é¢˜è§£å†³


**âŒ æµ‹è¯•è¿è¡Œç¼“æ…¢**
```
é—®é¢˜åŸå› ï¼šä½¿ç”¨çœŸå®æ•°æ®åº“ï¼Œç½‘ç»œIOè€—æ—¶
è§£å†³æ–¹æ¡ˆï¼š
- å•å…ƒæµ‹è¯•ä½¿ç”¨å†…å­˜æ•°æ®åº“H2
- åˆç†ä½¿ç”¨Mockå‡å°‘å¤–éƒ¨ä¾èµ–
- æµ‹è¯•æ•°æ®å°½é‡ç®€å•ï¼Œé¿å…å¤§é‡æ•°æ®æ“ä½œ
```

**âŒ æµ‹è¯•æ•°æ®æ±¡æŸ“**  
```
é—®é¢˜åŸå› ï¼šæµ‹è¯•åæ•°æ®æ²¡æœ‰æ¸…ç†ï¼Œå½±å“å…¶ä»–æµ‹è¯•
è§£å†³æ–¹æ¡ˆï¼š
- ä½¿ç”¨@Transactionalè‡ªåŠ¨å›æ»š
- æ¯ä¸ªæµ‹è¯•å‰æ¸…ç†ç›¸å…³æ•°æ®
- ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“
```

**âŒ æµ‹è¯•è¦†ç›–ç‡ä½**
```
é—®é¢˜åŸå› ï¼šç¼ºå°‘è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µæµ‹è¯•  
è§£å†³æ–¹æ¡ˆï¼š
- åˆ†æè¦†ç›–ç‡æŠ¥å‘Šï¼Œè¯†åˆ«æœªè¦†ç›–ä»£ç 
- è¡¥å……å¼‚å¸¸å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•
- é‡æ„ä»£ç æé«˜å¯æµ‹è¯•æ€§
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å•å…ƒæµ‹è¯•å¦‚ä½“æ£€ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½è¦éªŒ
- DAOå±‚æµ‹è¯•é‡æ•°æ®ï¼Œå‡†å¤‡æ¸…ç†æ˜¯å…³é”®  
- MockæŠ€æœ¯æ¥å¸®å¿™ï¼Œéš”ç¦»ä¾èµ–æµ‹è¯•å¿«
- è¦†ç›–ç‡é«˜è´¨é‡å¥½ï¼Œä½†è¦é¿å…ä¸ºæµ‹è€Œæµ‹