---
title: 3ã€èµ„æºå…³é—­ä¸ç”Ÿå‘½å‘¨æœŸ
---
## ğŸ“š ç›®å½•

1. [ä¸ºä»€ä¹ˆè¦å…³é—­æ•°æ®åº“èµ„æº](#1-ä¸ºä»€ä¹ˆè¦å…³é—­æ•°æ®åº“èµ„æº)
2. [JDBCèµ„æºçš„ç”Ÿå‘½å‘¨æœŸ](#2-JDBCèµ„æºçš„ç”Ÿå‘½å‘¨æœŸ)
3. [èµ„æºå…³é—­çš„æ­£ç¡®é¡ºåº](#3-èµ„æºå…³é—­çš„æ­£ç¡®é¡ºåº)
4. [ä¼ ç»Ÿçš„èµ„æºå…³é—­æ–¹å¼](#4-ä¼ ç»Ÿçš„èµ„æºå…³é—­æ–¹å¼)
5. [ç°ä»£åŒ–çš„èµ„æºç®¡ç†](#5-ç°ä»£åŒ–çš„èµ„æºç®¡ç†)
6. [è¿æ¥æ³„æ¼çš„é¢„é˜²ä¸æ£€æµ‹](#6-è¿æ¥æ³„æ¼çš„é¢„é˜²ä¸æ£€æµ‹)
7. [æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±](#7-æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ ä¸ºä»€ä¹ˆè¦å…³é—­æ•°æ®åº“èµ„æº


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“èµ„æº


**ç®€å•ç†è§£**ï¼šæŠŠæ•°æ®åº“èµ„æºæƒ³è±¡æˆå›¾ä¹¦é¦†çš„ä¹¦ç±å€Ÿé˜…

```
ç°å®åœºæ™¯å¯¹æ¯”ï¼š
å›¾ä¹¦é¦†å€Ÿä¹¦ â†’ çœ‹å®Œè¦è¿˜ä¹¦ â†’ åˆ«äººæ‰èƒ½å€Ÿ
æ•°æ®åº“è¿æ¥ â†’ ç”¨å®Œè¦å…³é—­ â†’ ç³»ç»Ÿæ‰èƒ½é‡å¤åˆ©ç”¨

å¦‚æœä¸è¿˜ä¹¦ï¼šå›¾ä¹¦é¦†çš„ä¹¦è¶Šæ¥è¶Šå°‘ï¼Œæœ€åæ²¡ä¹¦å¯å€Ÿ
å¦‚æœä¸å…³é—­ï¼šæ•°æ®åº“è¿æ¥è¶Šæ¥è¶Šå°‘ï¼Œæœ€åæ— æ³•è¿æ¥
```

**ğŸ”¸ JDBCä¸­çš„ä¸‰å¤§æ ¸å¿ƒèµ„æº**

- **Connectionï¼ˆè¿æ¥ï¼‰**ï¼šå°±åƒæ˜¯å»å›¾ä¹¦é¦†çš„é€šè¡Œè¯
- **Statementï¼ˆè¯­å¥æ‰§è¡Œå™¨ï¼‰**ï¼šå°±åƒæ˜¯å€Ÿä¹¦çš„ç”³è¯·è¡¨
- **ResultSetï¼ˆç»“æœé›†ï¼‰**ï¼šå°±åƒæ˜¯å€Ÿåˆ°çš„ä¹¦ç±æœ¬èº«

### 1.2 ä¸å…³é—­èµ„æºçš„ä¸¥é‡åæœ


**ğŸ’¥ èµ„æºè€—å°½é—®é¢˜**

```
æ•°æ®åº“æœåŠ¡å™¨çŠ¶æ€ï¼š
åˆå§‹çŠ¶æ€ï¼šå¯ç”¨è¿æ¥ 100ä¸ª âœ…
ä½¿ç”¨10ä¸ªä¸å…³é—­ï¼šå‰©ä½™è¿æ¥ 90ä¸ª âš ï¸
ä½¿ç”¨50ä¸ªä¸å…³é—­ï¼šå‰©ä½™è¿æ¥ 50ä¸ª âŒ
ä½¿ç”¨100ä¸ªä¸å…³é—­ï¼šå‰©ä½™è¿æ¥ 0ä¸ª ğŸš¨

ç»“æœï¼šæ–°ç”¨æˆ·æ— æ³•è®¿é—®ç½‘ç«™ï¼
```

**âš¡ æ€§èƒ½é—®é¢˜**
- **å†…å­˜æ³„æ¼**ï¼šæ¯ä¸ªæœªå…³é—­çš„è¿æ¥å ç”¨å†…å­˜ä¸é‡Šæ”¾
- **CPUæµªè´¹**ï¼šæ•°æ®åº“æœåŠ¡å™¨ç»´æŠ¤æ— ç”¨è¿æ¥æ¶ˆè€—èµ„æº
- **ç½‘ç»œèµ„æº**ï¼šæ— ç”¨çš„ç½‘ç»œè¿æ¥å ç”¨ç½‘ç»œå¸¦å®½

> âš ï¸ **çœŸå®æ¡ˆä¾‹**ï¼šæŸç”µå•†ç½‘ç«™å› ä¸ºè¿æ¥æ³„æ¼ï¼ŒåŒ11å½“å¤©ç³»ç»Ÿå´©æºƒï¼ŒæŸå¤±æ•°ç™¾ä¸‡ï¼

### 1.3 èµ„æºå…³é—­çš„æœ¬è´¨å«ä¹‰


**ğŸ”¸ å…³é—­ â‰  åˆ é™¤ï¼Œè€Œæ˜¯å½’è¿˜**

```
é”™è¯¯ç†è§£ï¼šå…³é—­ = é”€æ¯èµ„æº
æ­£ç¡®ç†è§£ï¼šå…³é—­ = å½’è¿˜ç»™èµ„æºæ± ï¼Œä¾›å…¶ä»–äººä½¿ç”¨

ç±»æ¯”ï¼š
é…’åº—é€€æˆ¿ â‰  æ‹†æ‰æˆ¿é—´
è€Œæ˜¯è®©æˆ¿é—´é‡æ–°å¯ä»¥è¢«é¢„è®¢
```

---

## 2. ğŸ”„ JDBCèµ„æºçš„ç”Ÿå‘½å‘¨æœŸ


### 2.1 èµ„æºçš„åˆ›å»ºè¿‡ç¨‹


**ğŸ“Š JDBCèµ„æºåˆ›å»ºé“¾**

```
æ•°æ®åº“è¿æ¥åˆ›å»ºæµç¨‹ï¼š

1. è·å–Connection           2. åˆ›å»ºStatement        3. æ‰§è¡ŒæŸ¥è¯¢å¾—åˆ°ResultSet
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æ•°æ®åº“é©±åŠ¨  â”‚ --------> â”‚ SQLæ‰§è¡Œå™¨   â”‚ --------> â”‚   æŸ¥è¯¢ç»“æœ   â”‚
   â”‚             â”‚           â”‚             â”‚           â”‚             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    Connection conn           Statement stmt            ResultSet rs
```

**ğŸ”¸ åˆ›å»ºé¡ºåºå¿…é¡»æ˜¯ï¼šConnection â†’ Statement â†’ ResultSet**

```java
// æ­£ç¡®çš„åˆ›å»ºé¡ºåº
Connection conn = DriverManager.getConnection(url, user, password);  // ç¬¬1æ­¥
PreparedStatement pstmt = conn.prepareStatement(sql);                // ç¬¬2æ­¥  
ResultSet rs = pstmt.executeQuery();                                 // ç¬¬3æ­¥
```

### 2.2 èµ„æºçš„ä¾èµ–å…³ç³»


**ğŸ”— ä¸‰è€…çš„ä¾èµ–å…³ç³»**

```
ä¾èµ–å…³ç³»å›¾ï¼š
Connection (çˆ¶çº§èµ„æº)
    â”‚
    â”œâ”€â”€ Statement (å­çº§èµ„æº)
    â”‚     â”‚
    â”‚     â””â”€â”€ ResultSet (å­™çº§èµ„æº)
    â”‚
    â””â”€â”€ Statement (å¯ä»¥æœ‰å¤šä¸ª)
          â”‚
          â””â”€â”€ ResultSet
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
- **Connection** = å·¥å‚çš„å¤§é—¨ï¼Œæ²¡æœ‰å¤§é—¨å°±è¿›ä¸äº†å·¥å‚
- **Statement** = å·¥å‚é‡Œçš„ç”Ÿäº§çº¿ï¼Œå¤§é—¨å…³äº†ç”Ÿäº§çº¿ä¹Ÿæ²¡ç”¨
- **ResultSet** = ç”Ÿäº§å‡ºæ¥çš„äº§å“ï¼Œç”Ÿäº§çº¿åœäº†äº§å“ä¹Ÿå°±æ²¡æ„ä¹‰äº†

### 2.3 èµ„æºçŠ¶æ€çš„å˜åŒ–


**ğŸ“ˆ èµ„æºçŠ¶æ€æµè½¬å›¾**

```
èµ„æºçŠ¶æ€å˜åŒ–ï¼š

åˆ›å»º â†’ ä½¿ç”¨ä¸­ â†’ å…³é—­ â†’ å¯å¤ç”¨
 â”‚       â”‚       â”‚       â”‚
 â–¼       â–¼       â–¼       â–¼
åˆå§‹    æ´»è·ƒ    é‡Šæ”¾    ç­‰å¾…ä¸‹æ¬¡ä½¿ç”¨

Connection:  [åˆ›å»º] â†’ [è¿æ¥æ•°æ®åº“] â†’ [å…³é—­] â†’ [å›åˆ°è¿æ¥æ± ]
Statement:   [åˆ›å»º] â†’ [å‡†å¤‡SQL]    â†’ [å…³é—­] â†’ [å†…å­˜é‡Šæ”¾]
ResultSet:   [åˆ›å»º] â†’ [éå†æ•°æ®]   â†’ [å…³é—­] â†’ [å†…å­˜é‡Šæ”¾]
```

---

## 3. âš–ï¸ èµ„æºå…³é—­çš„æ­£ç¡®é¡ºåº


### 3.1 ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦


**ğŸ”¸ å…³é—­é¡ºåº = åˆ›å»ºé¡ºåºçš„åå‘**

> ğŸ’¡ **è®°å¿†å£è¯€**ï¼šå…ˆå¼€çš„åå…³ï¼Œåå¼€çš„å…ˆå…³ï¼ˆå°±åƒç©¿è„±è¡£æœä¸€æ ·ï¼‰

```
åˆ›å»ºé¡ºåºï¼šConnection â†’ Statement â†’ ResultSet
å…³é—­é¡ºåºï¼šResultSet â†’ Statement â†’ Connection

ä¸ºä»€ä¹ˆè¦åå‘ï¼Ÿ
å› ä¸ºå­èµ„æºä¾èµ–çˆ¶èµ„æºï¼Œå¿…é¡»å…ˆæ–­å¼€å­èµ„æºçš„ä¾èµ–
```

### 3.2 é”™è¯¯é¡ºåºçš„åæœ


**âŒ é”™è¯¯ç¤ºä¾‹ï¼šå…ˆå…³çˆ¶èµ„æº**

```java
// å±é™©æ“ä½œï¼
conn.close();        // å…ˆå…³é—­Connection
rs.close();          // ResultSetå·²ç»æ— æ•ˆäº†ï¼å¯èƒ½æŠ¥é”™
stmt.close();        // Statementä¹Ÿå¯èƒ½æ— æ•ˆï¼
```

**åæœè¯´æ˜**ï¼š
- å¯èƒ½æŠ›å‡ºå¼‚å¸¸ `SQLException: Connection is closed`
- èµ„æºæ²¡æœ‰æ­£ç¡®é‡Šæ”¾ï¼Œé€ æˆå†…å­˜æ³„æ¼
- æ•°æ®åº“æœåŠ¡å™¨è®°å½•å¼‚å¸¸å…³é—­

### 3.3 æ­£ç¡®çš„å…³é—­é¡ºåº


**âœ… æ­£ç¡®ç¤ºä¾‹**

```java
// å®‰å…¨çš„å…³é—­é¡ºåº
if (rs != null) rs.close();       // 1. å…ˆå…³ResultSet
if (stmt != null) stmt.close();   // 2. å†å…³Statement  
if (conn != null) conn.close();   // 3. æœ€åå…³Connection
```

**ğŸ”¸ é¡ºåºè®°å¿†æ³•**

| æ­¥éª¤ | èµ„æºç±»å‹ | è®°å¿†æ–¹æ³• | ç±»æ¯” |
|------|---------|----------|------|
| 1ï¸âƒ£ | **ResultSet** | `æ•°æ®ç»“æœæœ€å…ˆå…³` | ä¹¦çœ‹å®Œäº†å…ˆæ”¾ä¸‹ |
| 2ï¸âƒ£ | **Statement** | `æ‰§è¡Œå™¨ç¬¬äºŒå…³` | ç”³è¯·è¡¨å¡«å®Œå°±æ’•æ‰ |
| 3ï¸âƒ£ | **Connection** | `è¿æ¥é€šé“æœ€åå…³` | ç¦»å¼€å›¾ä¹¦é¦†äº¤è¿˜é€šè¡Œè¯ |

---

## 4. ğŸ› ï¸ ä¼ ç»Ÿçš„èµ„æºå…³é—­æ–¹å¼


### 4.1 æœ€åŸå§‹çš„å…³é—­æ–¹å¼ï¼ˆä¸æ¨èï¼‰


**âŒ ç®€å•ç²—æš´çš„å…³é—­**

```java
public void badExample() {
    Connection conn = DriverManager.getConnection(url, user, password);
    PreparedStatement pstmt = conn.prepareStatement("SELECT * FROM users");
    ResultSet rs = pstmt.executeQuery();
    
    // å¤„ç†ç»“æœ...
    
    // ç›´æ¥å…³é—­ï¼Œæ²¡æœ‰å¼‚å¸¸å¤„ç†
    rs.close();
    pstmt.close();
    conn.close();  // å¦‚æœå‰é¢æŠ›å¼‚å¸¸ï¼Œè¿™äº›ä»£ç ä¸ä¼šæ‰§è¡Œï¼
}
```

**é—®é¢˜**ï¼šå¦‚æœä¸­é—´æŠ›å¼‚å¸¸ï¼Œèµ„æºå°±å…³é—­ä¸äº†äº†ï¼

### 4.2 ä¼ ç»Ÿçš„finallyå—æ–¹å¼


**âœ… æ ‡å‡†çš„finallyå…³é—­æ¨¡å¼**

```java
public void traditionalWay() {
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;
    
    try {
        // è·å–è¿æ¥å’Œæ‰§è¡ŒæŸ¥è¯¢
        conn = DriverManager.getConnection(url, user, password);
        pstmt = conn.prepareStatement("SELECT * FROM users WHERE age > ?");
        pstmt.setInt(1, 18);
        rs = pstmt.executeQuery();
        
        // å¤„ç†ç»“æœ
        while(rs.next()) {
            System.out.println(rs.getString("name"));
        }
        
    } catch (SQLException e) {
        e.printStackTrace();
    } finally {
        // ä¿è¯èµ„æºä¸€å®šä¼šè¢«å…³é—­
        closeResource(rs);
        closeResource(pstmt);  
        closeResource(conn);
    }
}

// å®‰å…¨å…³é—­å•ä¸ªèµ„æºçš„å·¥å…·æ–¹æ³•
private void closeResource(AutoCloseable resource) {
    if (resource != null) {
        try {
            resource.close();
        } catch (Exception e) {
            e.printStackTrace(); // è®°å½•å…³é—­å¼‚å¸¸ï¼Œä½†ä¸å½±å“ç¨‹åºç»§ç»­
        }
    }
}
```

**ğŸ”¸ è¿™ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹**

| ä¼˜ç‚¹ âœ… | ç¼ºç‚¹ âŒ |
|---------|---------|
| æ— è®ºæ˜¯å¦å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œfinally | ä»£ç å†—é•¿ï¼Œé‡å¤æ€§é«˜ |
| å¯ä»¥å¤„ç†å…³é—­æ—¶çš„å¼‚å¸¸ | éœ€è¦å¤šä¸ªnullæ£€æŸ¥ |
| é€»è¾‘æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£ | å®¹æ˜“å¿˜è®°å…³é—­æŸä¸ªèµ„æº |

---

## 5. ğŸš€ ç°ä»£åŒ–çš„èµ„æºç®¡ç†


### 5.1 try-with-resourcesè¯­æ³•ä»‹ç»


**ğŸ’¡ ä»€ä¹ˆæ˜¯try-with-resources**

> **ç®€å•ç†è§£**ï¼šJava 7å¼•å…¥çš„è¯­æ³•ç³–ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å…³é—­èµ„æºï¼Œå°±åƒæ™ºèƒ½é—¨é”ï¼Œå‡ºé—¨è‡ªåŠ¨é”é—¨

**ğŸ”¸ åŸºæœ¬è¯­æ³•ç»“æ„**

```java
try (èµ„æºå£°æ˜) {
    // ä½¿ç”¨èµ„æº
} catch (å¼‚å¸¸ç±»å‹ e) {
    // å¤„ç†å¼‚å¸¸
}
// èµ„æºè‡ªåŠ¨å…³é—­ï¼
```

### 5.2 åœ¨JDBCä¸­ä½¿ç”¨try-with-resources


**âœ… ç°ä»£åŒ–çš„å†™æ³•**

```java
public void modernWay() {
    String sql = "SELECT name, age FROM users WHERE age > ?";
    
    try (Connection conn = DriverManager.getConnection(url, user, password);
         PreparedStatement pstmt = conn.prepareStatement(sql);
         ResultSet rs = pstmt.executeQuery()) {
        
        pstmt.setInt(1, 18);
        
        // å¤„ç†ç»“æœ
        while(rs.next()) {
            String name = rs.getString("name");
            int age = rs.getInt("age");
            System.out.println(name + " - " + age);
        }
        
    } catch (SQLException e) {
        System.err.println("æ•°æ®åº“æ“ä½œå¤±è´¥: " + e.getMessage());
    }
    // æ‰€æœ‰èµ„æºè‡ªåŠ¨æŒ‰æ­£ç¡®é¡ºåºå…³é—­ï¼
}
```

### 5.3 try-with-resourcesçš„å·¥ä½œåŸç†


**ğŸ”§ è‡ªåŠ¨å…³é—­æœºåˆ¶**

```
å·¥ä½œæµç¨‹ï¼š
1. è¿›å…¥tryå— â†’ åˆ›å»ºèµ„æºï¼ˆConnectionã€Statementã€ResultSetï¼‰
2. æ‰§è¡Œä»£ç  â†’ æ­£å¸¸ä½¿ç”¨èµ„æº
3. ç¦»å¼€tryå— â†’ è‡ªåŠ¨è°ƒç”¨close()æ–¹æ³•
4. å…³é—­é¡ºåº â†’ è‡ªåŠ¨æŒ‰å£°æ˜çš„åå‘é¡ºåºå…³é—­

å£°æ˜é¡ºåºï¼šconn â†’ pstmt â†’ rs
å…³é—­é¡ºåºï¼šrs â†’ pstmt â†’ conn (å®Œå…¨æ­£ç¡®ï¼)
```

**â­ try-with-resourcesçš„ä¼˜åŠ¿**

| æ–¹é¢ | ä¼ ç»Ÿfinally | try-with-resources |
|------|-------------|-------------------|
| **ä»£ç é•¿åº¦** | 20-30è¡Œ | 8-12è¡Œ |
| **å‡ºé”™æ¦‚ç‡** | å®¹æ˜“å¿˜è®°å…³é—­ | è‡ªåŠ¨å…³é—­ï¼Œé›¶å‡ºé”™ |
| **å¼‚å¸¸å¤„ç†** | éœ€è¦æ‰‹åŠ¨å¤„ç† | è‡ªåŠ¨å¤„ç† |
| **å¯è¯»æ€§** | ä¸šåŠ¡ä»£ç è¢«æ‰“æ–­ | ä¸šåŠ¡ä»£ç é›†ä¸­ |

### 5.4 æ··åˆä½¿ç”¨åœºæ™¯


**ğŸ”¸ éƒ¨åˆ†èµ„æºç”¨try-with-resources**

```java
public List<User> getUsers(Connection conn) { // è¿æ¥ä»å¤–éƒ¨ä¼ å…¥
    List<User> users = new ArrayList<>();
    String sql = "SELECT * FROM users";
    
    try (PreparedStatement pstmt = conn.prepareStatement(sql);
         ResultSet rs = pstmt.executeQuery()) {
        
        while(rs.next()) {
            User user = new User();
            user.setName(rs.getString("name"));
            user.setAge(rs.getInt("age"));
            users.add(user);
        }
        
    } catch (SQLException e) {
        throw new RuntimeException("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥", e);
    }
    // æ³¨æ„ï¼šè¿™é‡Œä¸å…³é—­connï¼Œå› ä¸ºæ˜¯å¤–éƒ¨ä¼ å…¥çš„
    
    return users;
}
```

---

## 6. ğŸ•µï¸ è¿æ¥æ³„æ¼çš„é¢„é˜²ä¸æ£€æµ‹


### 6.1 ä»€ä¹ˆæ˜¯è¿æ¥æ³„æ¼


**ğŸ”¸ é€šä¿—è§£é‡Š**

> **è¿æ¥æ³„æ¼**å°±åƒæ°´é¾™å¤´æ²¡å…³ç´§ï¼Œä¸€æ»´æ»´æ¼æ°´ã€‚å•ç‹¬çœ‹ä¸ä¸¥é‡ï¼Œä½†ç§¯å°‘æˆå¤šå°±ä¼šé€ æˆæ°´è´¹æš´æ¶¨

```
è¿æ¥æ³„æ¼è¿‡ç¨‹ï¼š
ç”¨æˆ·Aè®¿é—® â†’ åˆ›å»ºè¿æ¥ â†’ å¿˜è®°å…³é—­ â†’ è¿æ¥å˜æˆ"åƒµå°¸è¿æ¥"
ç”¨æˆ·Bè®¿é—® â†’ åˆ›å»ºè¿æ¥ â†’ å¿˜è®°å…³é—­ â†’ åˆå¤šä¸€ä¸ª"åƒµå°¸è¿æ¥"
...
ç”¨æˆ·Zè®¿é—® â†’ æƒ³è¦è¿æ¥ â†’ è¿æ¥æ± ç©ºäº† â†’ ç½‘ç«™å´©æºƒï¼
```

### 6.2 è¿æ¥æ³„æ¼çš„æ£€æµ‹æ–¹æ³•


**ğŸ” æ£€æµ‹è¿æ¥æ³„æ¼çš„ä¿¡å·**

| ç—‡çŠ¶ | è¯´æ˜ | æ£€æŸ¥æ–¹æ³• |
|------|------|----------|
| **æ•°æ®åº“è¿æ¥æ•°æŒç»­å¢é•¿** | æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥ç¨³å®š | æŸ¥çœ‹æ•°æ®åº“ç®¡ç†å·¥å…· |
| **åº”ç”¨ç¨‹åºå“åº”è¶Šæ¥è¶Šæ…¢** | è·å–è¿æ¥æ—¶é—´å˜é•¿ | ç›‘æ§å“åº”æ—¶é—´ |
| **æœ€ç»ˆæ— æ³•è¿æ¥æ•°æ®åº“** | è¿æ¥æ± è€—å°½ | æŸ¥çœ‹é”™è¯¯æ—¥å¿— |

**ğŸ› ï¸ æ£€æµ‹å·¥å…·å’Œæ–¹æ³•**

```sql
-- MySQLæŸ¥çœ‹å½“å‰è¿æ¥æ•°
SHOW STATUS LIKE 'Threads_connected';

-- æŸ¥çœ‹æœ€å¤§è¿æ¥æ•°
SHOW VARIABLES LIKE 'max_connections';

-- æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿æ¥
SHOW PROCESSLIST;
```

### 6.3 é¢„é˜²è¿æ¥æ³„æ¼çš„ç­–ç•¥


**ğŸ›¡ï¸ é¢„é˜²ç­–ç•¥æ¸…å•**

- âœ… **å¼ºåˆ¶ä½¿ç”¨try-with-resources**ï¼šå…¬å¸ä»£ç è§„èŒƒå¼ºåˆ¶è¦æ±‚
- âœ… **ä»£ç å®¡æŸ¥**ï¼šåŒäº‹äº’ç›¸æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿èµ„æºå…³é—­
- âœ… **è¿æ¥è¶…æ—¶è®¾ç½®**ï¼šæ•°æ®åº“è‡ªåŠ¨å›æ”¶é•¿æ—¶é—´æœªä½¿ç”¨çš„è¿æ¥
- âœ… **ç›‘æ§æŠ¥è­¦**ï¼šè¿æ¥æ•°è¶…è¿‡é˜ˆå€¼æ—¶è‡ªåŠ¨æŠ¥è­¦

**ğŸ”§ è¿æ¥æ± é…ç½®ç¤ºä¾‹**

```java
// è¿æ¥æ± é˜²æ³„æ¼é…ç½®
HikariConfig config = new HikariConfig();
config.setMaximumPoolSize(20);           // æœ€å¤§è¿æ¥æ•°
config.setConnectionTimeout(30000);      // è·å–è¿æ¥è¶…æ—¶æ—¶é—´
config.setIdleTimeout(600000);          // ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´
config.setMaxLifetime(1800000);         // è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´
config.setLeakDetectionThreshold(60000); // è¿æ¥æ³„æ¼æ£€æµ‹æ—¶é—´é˜ˆå€¼
```

---

## 7. ğŸ“‹ æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±


### 7.1 æœ€ä½³å®è·µæ±‡æ€»


**â­ é»„é‡‘å‡†åˆ™**

1. **ä¼˜å…ˆä½¿ç”¨try-with-resources** â­â­â­
2. **ç»ä¸å¿½ç•¥èµ„æºå…³é—­** â­â­â­  
3. **æŒ‰æ­£ç¡®é¡ºåºå…³é—­** â­â­
4. **ä½¿ç”¨è¿æ¥æ± è€Œéç›´æ¥è¿æ¥** â­â­
5. **è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´** â­

**âœ… æ¨èçš„ä»£ç æ¨¡æ¿**

```java
public class UserDAO {
    
    // æ¨èï¼šæ ‡å‡†çš„CRUDæ“ä½œæ¨¡æ¿
    public List<User> findUsersByAge(int minAge) {
        List<User> users = new ArrayList<>();
        String sql = "SELECT id, name, age FROM users WHERE age >= ?";
        
        try (Connection conn = getConnection();
             PreparedStatement pstmt = conn.prepareStatement(sql)) {
            
            pstmt.setInt(1, minAge);
            
            try (ResultSet rs = pstmt.executeQuery()) {
                while(rs.next()) {
                    User user = new User();
                    user.setId(rs.getLong("id"));
                    user.setName(rs.getString("name"));
                    user.setAge(rs.getInt("age"));
                    users.add(user);
                }
            }
            
        } catch (SQLException e) {
            throw new RuntimeException("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥: " + e.getMessage(), e);
        }
        
        return users;
    }
}
```

### 7.2 å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ


**ğŸ•³ï¸ é™·é˜±1ï¼šåœ¨å¾ªç¯ä¸­åˆ›å»ºè¿æ¥**

```java
// âŒ é”™è¯¯ï¼šæ¯æ¬¡å¾ªç¯éƒ½åˆ›å»ºæ–°è¿æ¥
for(int i = 0; i < 1000; i++) {
    try (Connection conn = getConnection()) {
        // æ‰§è¡Œæ“ä½œ
    }
}

// âœ… æ­£ç¡®ï¼šä¸€ä¸ªè¿æ¥æ‰§è¡Œå¤šæ¬¡æ“ä½œ
try (Connection conn = getConnection()) {
    for(int i = 0; i < 1000; i++) {
        // æ‰§è¡Œæ“ä½œï¼Œå¤ç”¨è¿æ¥
    }
}
```

**ğŸ•³ï¸ é™·é˜±2ï¼šå¼‚å¸¸å¤„ç†ä¸­å¿˜è®°å…³é—­èµ„æº**

```java
// âŒ é”™è¯¯ï¼šcatchä¸­é‡æ–°æŠ›å¼‚å¸¸ï¼Œfinallyæ²¡æœ‰æ‰§è¡Œ
try {
    // æ•°æ®åº“æ“ä½œ
} catch (SQLException e) {
    throw new RuntimeException(e); // è¿™é‡ŒæŠ›å¼‚å¸¸ï¼Œfinallyä¸æ‰§è¡Œ
} finally {
    // å…³é—­èµ„æº - å¯èƒ½ä¸æ‰§è¡Œï¼
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨try-with-resourcesé¿å…è¿™ä¸ªé—®é¢˜
try (Connection conn = getConnection()) {
    // æ•°æ®åº“æ“ä½œ
} catch (SQLException e) {
    throw new RuntimeException(e); // èµ„æºä»ä¼šè‡ªåŠ¨å…³é—­
}
```

**ğŸ•³ï¸ é™·é˜±3ï¼šå…³é—­èµ„æºæ—¶åˆäº§ç”Ÿå¼‚å¸¸**

```java
// âŒ é”™è¯¯ï¼šå…³é—­å¼‚å¸¸æ©ç›–äº†åŸå§‹å¼‚å¸¸
finally {
    conn.close(); // å¦‚æœè¿™é‡ŒæŠ›å¼‚å¸¸ï¼Œä¼šæ©ç›–tryå—çš„å¼‚å¸¸
}

// âœ… æ­£ç¡®ï¼šå®‰å…¨å…³é—­ï¼Œä¸å½±å“åŸå§‹å¼‚å¸¸
finally {
    if (conn != null) {
        try {
            conn.close();
        } catch (SQLException e) {
            // è®°å½•æ—¥å¿—ï¼Œä½†ä¸é‡æ–°æŠ›å‡º
            logger.warn("å…³é—­è¿æ¥æ—¶å‘ç”Ÿå¼‚å¸¸", e);
        }
    }
}
```

### 7.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸš€ æ€§èƒ½ä¼˜åŒ–æ¸…å•**

| ä¼˜åŒ–ç‚¹ | è¯´æ˜ | æ•ˆæœ |
|--------|------|------|
| **ä½¿ç”¨è¿æ¥æ± ** | å¤ç”¨è¿æ¥ï¼Œå‡å°‘åˆ›å»ºå¼€é”€ | æ€§èƒ½æå‡80%+ |
| **æ‰¹å¤„ç†æ“ä½œ** | ä¸€æ¬¡ä¼ è¾“å¤šä¸ªSQL | å‡å°‘ç½‘ç»œå¾€è¿” |
| **é¢„ç¼–è¯‘è¯­å¥** | ä½¿ç”¨PreparedStatement | é˜²SQLæ³¨å…¥+æ€§èƒ½æå‡ |
| **åˆç†çš„è·å–æ•°æ®é‡** | é¿å…ä¸€æ¬¡æŸ¥è¯¢è¿‡å¤šæ•°æ® | å‡å°‘å†…å­˜å‹åŠ› |

---

## 8. ğŸ“– æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ èµ„æºå…³é—­æœ¬è´¨ï¼šå½’è¿˜ç»™ç³»ç»Ÿï¼Œä¾›ä»–äººä½¿ç”¨ï¼Œè€Œä¸æ˜¯åˆ é™¤
ğŸ”¸ å…³é—­é¡ºåºè§„åˆ™ï¼šResultSet â†’ Statement â†’ Connectionï¼ˆåå‘å…³é—­ï¼‰
ğŸ”¸ try-with-resourcesï¼šç°ä»£Javaçš„æ ‡å‡†èµ„æºç®¡ç†æ–¹å¼
ğŸ”¸ è¿æ¥æ³„æ¼å±å®³ï¼šèµ„æºè€—å°½ï¼Œç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·æ— æ³•è®¿é—®
ğŸ”¸ finallyå—å¤‡é€‰ï¼šä¼ ç»Ÿæ–¹å¼ï¼Œä»£ç å†—é•¿ä½†å…¼å®¹æ€§å¥½
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆèµ„æºç®¡ç†å¦‚æ­¤é‡è¦**
```
æ•°æ®åº“è¿æ¥ = çè´µèµ„æºï¼ˆæ•°é‡æœ‰é™ï¼‰
Webåº”ç”¨ = å¤šç”¨æˆ·å¹¶å‘è®¿é—®
ä¸æ­£ç¡®ç®¡ç† = èµ„æºè€—å°½ = ç³»ç»Ÿå´©æºƒ
æ­£ç¡®ç®¡ç† = èµ„æºå¤ç”¨ = ç³»ç»Ÿç¨³å®š
```

**ğŸ”¹ try-with-resources vs finally**
```
try-with-resourcesï¼š
â€¢ ä»£ç ç®€æ´ï¼Œè‡ªåŠ¨ç®¡ç†
â€¢ Java 7+æ”¯æŒ
â€¢ æ¨èç”¨äºæ–°é¡¹ç›®

finallyå—ï¼š
â€¢ ä»£ç å†—é•¿ï¼Œæ‰‹åŠ¨ç®¡ç†  
â€¢ æ‰€æœ‰ç‰ˆæœ¬æ”¯æŒ
â€¢ é€‚ç”¨äºè€é¡¹ç›®æˆ–ç‰¹æ®Šéœ€æ±‚
```

**ğŸ”¹ è¿æ¥æ³„æ¼çš„é¢„é˜²æ€è·¯**
```
é¢„é˜² > æ£€æµ‹ > ä¿®å¤
åˆ¶åº¦ > æŠ€æœ¯ > ç›‘æ§
è§„èŒƒ > å·¥å…· > è¡¥æ•‘
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


- **ä¼ä¸šé¡¹ç›®å¼€å‘**ï¼šé¿å…ç”Ÿäº§ç¯å¢ƒè¿æ¥æ³„æ¼å¯¼è‡´çš„ç³»ç»Ÿæ•…éšœ
- **ä»£ç è´¨é‡æå‡**ï¼šå…»æˆè‰¯å¥½çš„èµ„æºç®¡ç†ä¹ æƒ¯
- **æ€§èƒ½ä¼˜åŒ–åŸºç¡€**ï¼šæ­£ç¡®çš„èµ„æºç®¡ç†æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å‰æ
- **é¢è¯•åŠ åˆ†é¡¹**ï¼šå±•ç°å¯¹JavaåŸºç¡€å’Œæœ€ä½³å®è·µçš„ç†è§£

### 8.4 è®°å¿†å£è¯€


**ğŸ“ èµ„æºç®¡ç†å£è¯€**
```
èµ„æºå®è´µéœ€çæƒœï¼Œç”¨å®ŒåŠæ—¶è¦å½’è¿˜
åˆ›å»ºé¡ºåºè¦è®°æ¸…ï¼Œå…³é—­åŠ¡å¿…è¦åå‘
try-with-resourceså¥½ï¼Œè‡ªåŠ¨ç®¡ç†ä¸å‡ºé”™
è¿æ¥æ³„æ¼å±å®³å¤§ï¼Œé¢„é˜²èƒœè¿‡å»è¡¥æ•‘
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†**
- **åˆ›å»º**ï¼šConnection â†’ Statement â†’ ResultSet
- **å…³é—­**ï¼šResultSet â†’ Statement â†’ Connection  
- **å·¥å…·**ï¼štry-with-resourcesè‡ªåŠ¨ç®¡ç†
- **åŸåˆ™**ï¼šç”¨å®Œå³å…³ï¼Œç»ä¸æ‹–å»¶