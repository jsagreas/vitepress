---
title: 2ã€PreparedStatementé¢„ç¼–è¯‘
---
## ğŸ“š ç›®å½•

1. [PreparedStatementæ˜¯ä»€ä¹ˆ](#1-PreparedStatementæ˜¯ä»€ä¹ˆ)
2. [ä¸ºä»€ä¹ˆè¦ç”¨PreparedStatement](#2-ä¸ºä»€ä¹ˆè¦ç”¨PreparedStatement)
3. [SQLé¢„ç¼–è¯‘æœºåˆ¶è¯¦è§£](#3-SQLé¢„ç¼–è¯‘æœºåˆ¶è¯¦è§£)
4. [å ä½ç¬¦å‚æ•°çš„ä½¿ç”¨](#4-å ä½ç¬¦å‚æ•°çš„ä½¿ç”¨)
5. [å‚æ•°è®¾ç½®æ–¹æ³•è¯¦è§£](#5-å‚æ•°è®¾ç½®æ–¹æ³•è¯¦è§£)
6. [SQLæ³¨å…¥æ”»å‡»é˜²æŠ¤](#6-SQLæ³¨å…¥æ”»å‡»é˜²æŠ¤)
7. [PreparedStatementæœ€ä½³å®è·µ](#7-PreparedStatementæœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ PreparedStatementæ˜¯ä»€ä¹ˆ


### 1.1 åŸºæœ¬æ¦‚å¿µ

**PreparedStatement** æ˜¯ `Statement` æ¥å£çš„å­æ¥å£ï¼Œå®ƒæ˜¯ **é¢„ç¼–è¯‘çš„SQLè¯­å¥å¯¹è±¡**ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒæˆ‘ä»¬åšèœæ—¶æå‰å‡†å¤‡å¥½é£Ÿæå’Œè°ƒæ–™ï¼ŒPreparedStatementå°±æ˜¯æå‰æŠŠSQLè¯­å¥çš„"æ¡†æ¶"å‡†å¤‡å¥½ï¼Œéœ€è¦çš„æ—¶å€™åªéœ€è¦å¡«å…¥å…·ä½“çš„æ•°æ®å³å¯ã€‚

```
æ™®é€šStatementï¼šæ¯æ¬¡éƒ½è¦é‡æ–°è§£æSQLè¯­å¥
PreparedStatementï¼šSQLè¯­å¥é¢„å…ˆç¼–è¯‘å¥½ï¼Œé‡å¤ä½¿ç”¨

å°±åƒï¼š
Statement = æ¯æ¬¡åšèœéƒ½é‡æ–°ä¹°èœã€æ´—èœã€åˆ‡èœ
PreparedStatement = æå‰å‡†å¤‡å¥½åŠæˆå“ï¼Œç‚’èœæ—¶ç›´æ¥ä¸‹é”…
```

### 1.2 åŸºæœ¬ä½¿ç”¨æµç¨‹

```
1. ç¼–å†™å¸¦å ä½ç¬¦(?)çš„SQLè¯­å¥
2. é€šè¿‡Connectionè·å–PreparedStatementå¯¹è±¡  
3. ä¸ºå ä½ç¬¦è®¾ç½®å…·ä½“å‚æ•°å€¼
4. æ‰§è¡ŒSQLè¯­å¥
5. å¤„ç†ç»“æœ
```

### 1.3 ä¸Statementçš„å…³ç³»

```
æ¥å£ç»§æ‰¿å…³ç³»ï¼š
Statement (çˆ¶æ¥å£)
    â†“
PreparedStatement (å­æ¥å£)
    â†“
CallableStatement (å­˜å‚¨è¿‡ç¨‹æ¥å£)

åŠŸèƒ½å¯¹æ¯”ï¼š
Statementï¼šé€‚åˆæ‰§è¡Œé™æ€SQL
PreparedStatementï¼šé€‚åˆæ‰§è¡ŒåŠ¨æ€SQL(æœ‰å‚æ•°)
CallableStatementï¼šä¸“é—¨è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
```

---

## 2. âš¡ ä¸ºä»€ä¹ˆè¦ç”¨PreparedStatement


### 2.1 æ ¸å¿ƒä¼˜åŠ¿å¯¹æ¯”


| å¯¹æ¯”ç»´åº¦ | **Statement** | **PreparedStatement** |
|---------|---------------|---------------------|
| ğŸš€ **æ€§èƒ½** | æ¯æ¬¡é‡æ–°ç¼–è¯‘ | é¢„ç¼–è¯‘ï¼Œé‡å¤åˆ©ç”¨ |
| ğŸ”’ **å®‰å…¨æ€§** | å®¹æ˜“SQLæ³¨å…¥ | æœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥ |
| ğŸ’» **æ˜“ç”¨æ€§** | å­—ç¬¦ä¸²æ‹¼æ¥éº»çƒ¦ | å ä½ç¬¦ç®€æ´æ¸…æ™° |
| ğŸ”§ **ç»´æŠ¤æ€§** | ä»£ç éš¾ä»¥ç»´æŠ¤ | ç»“æ„æ¸…æ™°æ˜“ç»´æŠ¤ |

### 2.2 Statementçš„é—®é¢˜æ¼”ç¤º


**é—®é¢˜1ï¼šå­—ç¬¦ä¸²æ‹¼æ¥å¤æ‚**
```java
// Statementæ–¹å¼ - ç¹çæ˜“é”™
String name = "å¼ ä¸‰";
int age = 25;
String sql = "INSERT INTO users(name, age) VALUES('" + name + "', " + age + ")";

// å¦‚æœnameåŒ…å«å•å¼•å·æ€ä¹ˆåŠï¼Ÿå¦‚æœæ˜¯æ—¥æœŸç±»å‹æ€ä¹ˆåŠï¼Ÿ
String problemName = "å¼ 'ä¸‰";  // ä¼šå¯¼è‡´SQLè¯­æ³•é”™è¯¯ï¼
```

**é—®é¢˜2ï¼šæ€§èƒ½ä½ä¸‹**
```java
// æ¯æ¬¡æ‰§è¡Œéƒ½è¦é‡æ–°ç¼–è¯‘SQL
for(int i = 0; i < 1000; i++) {
    String sql = "INSERT INTO users(name, age) VALUES('user" + i + "', " + (20+i) + ")";
    Statement stmt = conn.createStatement();
    stmt.executeUpdate(sql);  // æ¯æ¬¡éƒ½è¦é‡æ–°è§£æå’Œç¼–è¯‘SQL
}
```

### 2.3 PreparedStatementçš„è§£å†³æ–¹æ¡ˆ


**è§£å†³å¤æ‚æ‹¼æ¥**
```java
// PreparedStatementæ–¹å¼ - ç®€æ´æ¸…æ™°
String sql = "INSERT INTO users(name, age) VALUES(?, ?)";
PreparedStatement pstmt = conn.prepareStatement(sql);
pstmt.setString(1, "å¼ 'ä¸‰");    // è‡ªåŠ¨å¤„ç†ç‰¹æ®Šå­—ç¬¦
pstmt.setInt(2, 25);
pstmt.executeUpdate();
```

**æå‡æ€§èƒ½**
```java
// SQLåªç¼–è¯‘ä¸€æ¬¡ï¼Œé‡å¤ä½¿ç”¨
String sql = "INSERT INTO users(name, age) VALUES(?, ?)";
PreparedStatement pstmt = conn.prepareStatement(sql);  // é¢„ç¼–è¯‘

for(int i = 0; i < 1000; i++) {
    pstmt.setString(1, "user" + i);
    pstmt.setInt(2, 20 + i);
    pstmt.executeUpdate();  // é‡å¤ä½¿ç”¨é¢„ç¼–è¯‘çš„SQL
}
```

---

## 3. ğŸ”§ SQLé¢„ç¼–è¯‘æœºåˆ¶è¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯SQLé¢„ç¼–è¯‘

> ğŸ’¡ **é€šä¿—è§£é‡Š**ï¼šé¢„ç¼–è¯‘å°±æ˜¯æå‰æŠŠSQLè¯­å¥ç¿»è¯‘æˆæ•°æ®åº“èƒ½ç†è§£çš„"æœºå™¨è¯­è¨€"ï¼Œå°±åƒæå‰æŠŠä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼Œéœ€è¦æ—¶ç›´æ¥ä½¿ç”¨ç¿»è¯‘å¥½çš„ç‰ˆæœ¬ã€‚

```
SQLæ‰§è¡Œçš„å®Œæ•´è¿‡ç¨‹ï¼š

1. è¯­æ³•è§£æ    â†â€” æ£€æŸ¥SQLè¯­æ³•æ˜¯å¦æ­£ç¡®
2. è¯­ä¹‰åˆ†æ    â†â€” æ£€æŸ¥è¡¨åã€å­—æ®µåæ˜¯å¦å­˜åœ¨  
3. æ‰§è¡Œè®¡åˆ’ä¼˜åŒ– â†â€” å†³å®šå¦‚ä½•æœ€é«˜æ•ˆåœ°æ‰§è¡Œ
4. ç¼–è¯‘        â†â€” ç”Ÿæˆå¯æ‰§è¡Œä»£ç 
5. æ‰§è¡Œ        â†â€” çœŸæ­£æ‰§è¡ŒSQL
```

### 3.2 é¢„ç¼–è¯‘çš„å·¥ä½œåŸç†


**Statementæ¯æ¬¡æ‰§è¡Œçš„è¿‡ç¨‹ï¼š**
```
ç¬¬1æ¬¡ï¼šSQLè§£æ â†’ ç¼–è¯‘ â†’ æ‰§è¡Œ
ç¬¬2æ¬¡ï¼šSQLè§£æ â†’ ç¼–è¯‘ â†’ æ‰§è¡Œ  (é‡å¤åŠ³åŠ¨)
ç¬¬3æ¬¡ï¼šSQLè§£æ â†’ ç¼–è¯‘ â†’ æ‰§è¡Œ  (é‡å¤åŠ³åŠ¨)
```

**PreparedStatementçš„æ‰§è¡Œè¿‡ç¨‹ï¼š**
```
é¢„å¤„ç†é˜¶æ®µï¼šSQLè§£æ â†’ ç¼–è¯‘ â†’ ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ¨¡æ¿
ç¬¬1æ¬¡æ‰§è¡Œï¼šå¡«å…¥å‚æ•° â†’ æ‰§è¡Œ
ç¬¬2æ¬¡æ‰§è¡Œï¼šå¡«å…¥å‚æ•° â†’ æ‰§è¡Œ  (ç›´æ¥ä½¿ç”¨ç¼–è¯‘å¥½çš„ç‰ˆæœ¬)
ç¬¬3æ¬¡æ‰§è¡Œï¼šå¡«å…¥å‚æ•° â†’ æ‰§è¡Œ  (ç›´æ¥ä½¿ç”¨ç¼–è¯‘å¥½çš„ç‰ˆæœ¬)
```

### 3.3 é¢„ç¼–è¯‘çš„æ€§èƒ½ä¼˜åŠ¿


```
ğŸ”¸ èŠ‚çœCPUæ—¶é—´
- é¿å…é‡å¤çš„è¯­æ³•è§£æ
- é¿å…é‡å¤çš„ç¼–è¯‘è¿‡ç¨‹
- é¿å…é‡å¤çš„æ‰§è¡Œè®¡åˆ’ç”Ÿæˆ

ğŸ”¸ èŠ‚çœå†…å­˜å¼€é”€  
- ç¼–è¯‘ç»“æœå¯ä»¥ç¼“å­˜
- å¤šæ¬¡æ‰§è¡Œå…±äº«åŒä¸€ä¸ªæ‰§è¡Œè®¡åˆ’

ğŸ”¸ æé«˜æ‰§è¡Œæ•ˆç‡
- ç‰¹åˆ«æ˜¯åœ¨æ‰¹é‡æ“ä½œæ—¶æ•ˆæœæ˜¾è‘—
- æ•°æ®åº“å¯ä»¥è¿›è¡Œæ›´å¥½çš„ä¼˜åŒ–
```

> ğŸ“Š **æ€§èƒ½å¯¹æ¯”**ï¼šåœ¨æ‰§è¡Œ1000æ¬¡ç›¸ä¼¼SQLæ—¶ï¼ŒPreparedStatementæ¯”Statementå¿«3-5å€ï¼

---

## 4. ğŸ“ å ä½ç¬¦å‚æ•°çš„ä½¿ç”¨


### 4.1 å ä½ç¬¦ `?` çš„åŸºæœ¬æ¦‚å¿µ

å ä½ç¬¦ `?` æ˜¯PreparedStatementä¸­çš„**å‚æ•°æ ‡è®°**ï¼Œè¡¨ç¤ºè¿™é‡Œéœ€è¦å¡«å…¥ä¸€ä¸ªå…·ä½“çš„å€¼ã€‚

> ğŸ’¡ **å½¢è±¡æ¯”å–»**ï¼šå ä½ç¬¦å°±åƒå¡«ç©ºé¢˜ä¸­çš„æ¨ªçº¿ï¼Œå‘Šè¯‰æˆ‘ä»¬è¿™é‡Œéœ€è¦å¡«å…¥ç­”æ¡ˆã€‚

```sql
-- å¸¦å ä½ç¬¦çš„SQLæ¨¡æ¿
SELECT * FROM users WHERE name = ? AND age > ?

-- æ‰§è¡Œæ—¶ä¼šå˜æˆè¿™æ ·ï¼š
SELECT * FROM users WHERE name = 'å¼ ä¸‰' AND age > 18
```

### 4.2 å ä½ç¬¦ä½¿ç”¨è§„åˆ™


**ğŸ”¸ ä½ç½®ç¼–å·ä»1å¼€å§‹**
```java
String sql = "INSERT INTO users(name, age, email) VALUES(?, ?, ?)";
//                                                    1  2  3
// æ³¨æ„ï¼šç¼–å·ä»1å¼€å§‹ï¼Œä¸æ˜¯ä»0å¼€å§‹ï¼
```

**ğŸ”¸ å ä½ç¬¦åªèƒ½ç”¨äºæ•°æ®å€¼**
```java
// âœ… æ­£ç¡®ç”¨æ³• - ä½œä¸ºæ•°æ®å€¼
String sql = "SELECT * FROM users WHERE name = ? AND age = ?";

// âŒ é”™è¯¯ç”¨æ³• - ä¸èƒ½ç”¨äºè¡¨åæˆ–å­—æ®µå
String sql = "SELECT ? FROM ? WHERE name = ?";  // è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼
```

**ğŸ”¸ å ä½ç¬¦æ•°é‡è¦åŒ¹é…**
```java
String sql = "INSERT INTO users(name, age) VALUES(?, ?)";
PreparedStatement pstmt = conn.prepareStatement(sql);

// å¿…é¡»è®¾ç½®2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªéƒ½ä¸èƒ½å°‘
pstmt.setString(1, "å¼ ä¸‰");  // ç¬¬1ä¸ªå ä½ç¬¦
pstmt.setInt(2, 25);       // ç¬¬2ä¸ªå ä½ç¬¦
```

### 4.3 å¸¸è§å ä½ç¬¦ä½¿ç”¨åœºæ™¯


**æŸ¥è¯¢åœºæ™¯**
```java
// æ ¹æ®å¤šä¸ªæ¡ä»¶æŸ¥è¯¢ç”¨æˆ·
String sql = "SELECT * FROM users WHERE age BETWEEN ? AND ? AND city = ?";
PreparedStatement pstmt = conn.prepareStatement(sql);
pstmt.setInt(1, 18);        // æœ€å°å¹´é¾„
pstmt.setInt(2, 65);        // æœ€å¤§å¹´é¾„  
pstmt.setString(3, "åŒ—äº¬");   // åŸå¸‚
```

**æ›´æ–°åœºæ™¯**
```java
// æ›´æ–°ç”¨æˆ·ä¿¡æ¯
String sql = "UPDATE users SET email = ?, phone = ? WHERE id = ?";
PreparedStatement pstmt = conn.prepareStatement(sql);
pstmt.setString(1, "new@email.com");
pstmt.setString(2, "13888888888");
pstmt.setLong(3, 1001L);
```

**åˆ é™¤åœºæ™¯**
```java
// åˆ é™¤æŒ‡å®šæ¡ä»¶çš„è®°å½•
String sql = "DELETE FROM users WHERE create_time < ? AND status = ?";
PreparedStatement pstmt = conn.prepareStatement(sql);
pstmt.setDate(1, java.sql.Date.valueOf("2023-01-01"));
pstmt.setString(2, "inactive");
```

---

## 5. ğŸ› ï¸ å‚æ•°è®¾ç½®æ–¹æ³•è¯¦è§£


### 5.1 setXxx()æ–¹æ³•ä½“ç³»

PreparedStatementæä¾›äº†ä¸°å¯Œçš„ `setXxx()` æ–¹æ³•æ¥è®¾ç½®ä¸åŒç±»å‹çš„å‚æ•°ã€‚

> ğŸ’¡ **è®°å¿†æŠ€å·§**ï¼šæ–¹æ³•åéƒ½æ˜¯ `set` + `æ•°æ®ç±»å‹`ï¼Œæ¯”å¦‚è®¾ç½®å­—ç¬¦ä¸²å°±æ˜¯ `setString()`ï¼Œè®¾ç½®æ•´æ•°å°±æ˜¯ `setInt()`ã€‚

### 5.2 åŸºæœ¬æ•°æ®ç±»å‹è®¾ç½®


```java
String sql = "INSERT INTO student(name, age, score, is_active, birth_date) VALUES(?, ?, ?, ?, ?)";
PreparedStatement pstmt = conn.prepareStatement(sql);

// ğŸ”¸ å­—ç¬¦ä¸²ç±»å‹
pstmt.setString(1, "ææ˜");

// ğŸ”¸ æ•´æ•°ç±»å‹
pstmt.setInt(2, 20);           // int
pstmt.setLong(3, 1001L);       // long

// ğŸ”¸ å°æ•°ç±»å‹  
pstmt.setDouble(4, 95.5);      // double
pstmt.setFloat(5, 88.8f);      // float

// ğŸ”¸ å¸ƒå°”ç±»å‹
pstmt.setBoolean(6, true);     // boolean

// ğŸ”¸ æ—¥æœŸæ—¶é—´ç±»å‹
pstmt.setDate(7, java.sql.Date.valueOf("2000-01-01"));           // æ—¥æœŸ
pstmt.setTimestamp(8, java.sql.Timestamp.valueOf("2023-12-25 14:30:00")); // æ—¶é—´æˆ³
```

### 5.3 å¸¸ç”¨æ•°æ®ç±»å‹å¯¹åº”è¡¨


| Javaç±»å‹ | **PreparedStatementæ–¹æ³•** | **æ•°æ®åº“ç±»å‹** | **ç¤ºä¾‹** |
|----------|-------------------------|---------------|----------|
| String | `setString(int, String)` | VARCHAR, TEXT | `"å¼ ä¸‰"` |
| int | `setInt(int, int)` | INT, INTEGER | `25` |
| long | `setLong(int, long)` | BIGINT | `1001L` |
| double | `setDouble(int, double)` | DOUBLE | `99.9` |
| boolean | `setBoolean(int, boolean)` | BOOLEAN, TINYINT | `true` |
| java.sql.Date | `setDate(int, Date)` | DATE | `2023-12-25` |
| java.sql.Timestamp | `setTimestamp(int, Timestamp)` | DATETIME, TIMESTAMP | `2023-12-25 14:30:00` |

### 5.4 ç‰¹æ®Šæƒ…å†µå¤„ç†


**å¤„ç†NULLå€¼**
```java
// è®¾ç½®NULLå€¼
pstmt.setNull(2, java.sql.Types.VARCHAR);  // å­—ç¬¦ä¸²NULL
pstmt.setNull(3, java.sql.Types.INTEGER);  // æ•´æ•°NULL

// æˆ–è€…å¯¹äºå¯¹è±¡ç±»å‹ï¼Œç›´æ¥ä¼ null
pstmt.setString(2, null);  // ä¹Ÿå¯ä»¥è¿™æ ·è®¾ç½®NULL
```

**å¤„ç†å¤§æ•°æ®ç±»å‹**
```java
// å¤§æ–‡æœ¬
pstmt.setString(1, "å¾ˆé•¿å¾ˆé•¿çš„æ–‡æœ¬...");

// äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ï¼‰
FileInputStream fis = new FileInputStream("photo.jpg");
pstmt.setBinaryStream(2, fis);
```

### 5.5 å‚æ•°è®¾ç½®æœ€ä½³å®è·µ


```java
// âœ… æ¨èå†™æ³•ï¼šç±»å‹åŒ¹é…
pstmt.setInt(1, 25);          // æ•°æ®åº“å­—æ®µæ˜¯INT
pstmt.setString(2, "å¼ ä¸‰");     // æ•°æ®åº“å­—æ®µæ˜¯VARCHAR

// âš ï¸ é¿å…ç±»å‹ä¸åŒ¹é…
pstmt.setString(1, "25");     // æ•°æ®åº“æ˜¯INTï¼Œä½†ä¼ äº†String
```

---

## 6. ğŸ”’ SQLæ³¨å…¥æ”»å‡»é˜²æŠ¤


### 6.1 ä»€ä¹ˆæ˜¯SQLæ³¨å…¥æ”»å‡»

> ğŸ’¡ **é€šä¿—è§£é‡Š**ï¼šSQLæ³¨å…¥å°±åƒæ˜¯æœ‰äººåœ¨ä½ çš„æˆ¿é—¨é’¥åŒ™ä¸ŠåŠ¨æ‰‹è„šï¼Œè®©ä½ ä»¥ä¸ºç”¨çš„æ˜¯æ­£ç¡®çš„é’¥åŒ™ï¼Œå®é™…ä¸Šå´æ‰“å¼€äº†ä¸è¯¥æ‰“å¼€çš„é—¨ã€‚

**SQLæ³¨å…¥çš„åŸºæœ¬åŸç†**
```
æ­£å¸¸ç™»å½•ï¼šç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
æ¶æ„æ³¨å…¥ï¼šç”¨æˆ·è¾“å…¥ç‰¹æ®Šå­—ç¬¦ï¼Œæ”¹å˜äº†SQLè¯­å¥çš„é€»è¾‘å«ä¹‰

æ¯”å¦‚ï¼š
æ­£å¸¸è¾“å…¥ï¼šç”¨æˆ·å="admin", å¯†ç ="123456"  
æ¶æ„è¾“å…¥ï¼šç”¨æˆ·å="admin' OR '1'='1", å¯†ç ="éšä¾¿ä»€ä¹ˆ"
```

### 6.2 Statementå­˜åœ¨çš„å®‰å…¨æ¼æ´


**å±é™©ç¤ºä¾‹ï¼šç”¨æˆ·ç™»å½•éªŒè¯**
```java
// âŒ å±é™©çš„Statementæ–¹å¼
String username = request.getParameter("username");  // ç”¨æˆ·è¾“å…¥ï¼šadmin' OR '1'='1
String password = request.getParameter("password");  // ç”¨æˆ·è¾“å…¥ï¼šéšä¾¿ä»€ä¹ˆ

String sql = "SELECT * FROM users WHERE username='" + username + "' AND password='" + password + "'";
// æœ€ç»ˆSQLå˜æˆï¼š
// SELECT * FROM users WHERE username='admin' OR '1'='1' AND password='éšä¾¿ä»€ä¹ˆ'
// ç”±äº '1'='1' æ°¸è¿œä¸ºtrueï¼Œè¿™ä¸ªæŸ¥è¯¢ä¼šè¿”å›æ‰€æœ‰ç”¨æˆ·ï¼

Statement stmt = conn.createStatement();
ResultSet rs = stmt.executeQuery(sql);
if(rs.next()) {
    // æ”»å‡»è€…æˆåŠŸç™»å½•ï¼ï¼ï¼
}
```

**SQLæ³¨å…¥æ”»å‡»çš„å±å®³**
```
ğŸ”¸ ç»•è¿‡èº«ä»½éªŒè¯ - æ— éœ€å¯†ç ç™»å½•
ğŸ”¸ æ•°æ®æ³„éœ² - è·å–æ•æ„Ÿä¿¡æ¯  
ğŸ”¸ æ•°æ®ç¯¡æ”¹ - ä¿®æ”¹æ•°æ®åº“æ•°æ®
ğŸ”¸ ç³»ç»Ÿç ´å - åˆ é™¤é‡è¦æ•°æ®
ğŸ”¸ æƒé™æå‡ - è·å–ç®¡ç†å‘˜æƒé™
```

### 6.3 PreparedStatementå¦‚ä½•é˜²æ­¢SQLæ³¨å…¥


**å®‰å…¨ç¤ºä¾‹ï¼šé¢„ç¼–è¯‘é˜²æŠ¤**
```java
// âœ… å®‰å…¨çš„PreparedStatementæ–¹å¼
String sql = "SELECT * FROM users WHERE username=? AND password=?";
PreparedStatement pstmt = conn.prepareStatement(sql);

// æ¶æ„è¾“å…¥
String username = "admin' OR '1'='1";  // åŒ…å«SQLæ³¨å…¥ä»£ç 
String password = "éšä¾¿ä»€ä¹ˆ";

pstmt.setString(1, username);  // è¿™é‡Œusernameè¢«å½“ä½œçº¯æ–‡æœ¬å¤„ç†
pstmt.setString(2, password);  // passwordä¹Ÿè¢«å½“ä½œçº¯æ–‡æœ¬å¤„ç†

// å®é™…æ‰§è¡Œçš„SQLæ•ˆæœç›¸å½“äºï¼š
// SELECT * FROM users WHERE username='admin\' OR \'1\'=\'1' AND password='éšä¾¿ä»€ä¹ˆ'
// ç‰¹æ®Šå­—ç¬¦è¢«è½¬ä¹‰ï¼Œå¤±å»äº†SQLè¯­æ³•æ„ä¹‰
```

### 6.4 é˜²æŠ¤æœºåˆ¶åŸç†


```
SQLæ³¨å…¥é˜²æŠ¤åŸç†å›¾ï¼š

Statementæ–¹å¼ï¼š
ç”¨æˆ·è¾“å…¥ â†’ ç›´æ¥æ‹¼æ¥åˆ°SQL â†’ æ‰§è¡Œ
         â†‘
    SQLæ³¨å…¥ä»£ç æ··å…¥å…¶ä¸­

PreparedStatementæ–¹å¼ï¼š  
SQLæ¨¡æ¿ â†’ é¢„ç¼–è¯‘ â†’ å‚æ•°ç»‘å®š â†’ æ‰§è¡Œ
                    â†‘
              ç”¨æˆ·è¾“å…¥ä½œä¸ºçº¯æ•°æ®
```

**ğŸ”¸ é¢„ç¼–è¯‘é˜¶æ®µåˆ†ç¦»**
- SQLç»“æ„åœ¨é¢„ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®š
- å‚æ•°åªèƒ½ä½œä¸ºæ•°æ®å€¼ï¼Œæ— æ³•æ”¹å˜SQLç»“æ„
- ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬ä¹‰å¤„ç†

**ğŸ”¸ å‚æ•°åŒ–æŸ¥è¯¢**
```java
// SQLç»“æ„å’Œæ•°æ®å®Œå…¨åˆ†ç¦»
String sqlTemplate = "SELECT * FROM users WHERE name = ?";  // SQLç»“æ„
String userData = "ä»»ä½•ç”¨æˆ·è¾“å…¥";                             // çº¯æ•°æ®

// æ— è®ºuserDataåŒ…å«ä»€ä¹ˆå†…å®¹ï¼Œéƒ½åªä¼šè¢«å½“ä½œå­—ç¬¦ä¸²æ•°æ®å¤„ç†
```

### 6.5 å…¶ä»–å®‰å…¨æœ€ä½³å®è·µ


**è¾“å…¥éªŒè¯**
```java
// åœ¨ä½¿ç”¨PreparedStatementä¹‹å‰ï¼Œè¿˜åº”è¯¥è¿›è¡ŒåŸºæœ¬éªŒè¯
if (username == null || username.trim().isEmpty()) {
    throw new IllegalArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
}

if (password == null || password.length() < 6) {
    throw new IllegalArgumentException("å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½");
}
```

**æƒé™æ§åˆ¶**
```java
// æ•°æ®åº“ç”¨æˆ·æƒé™æœ€å°åŒ–åŸåˆ™
// åº”ç”¨ç¨‹åºè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åªç»™å¿…è¦çš„æƒé™
// ä¸è¦ä½¿ç”¨rootæˆ–adminç­‰é«˜æƒé™ç”¨æˆ·
```

---

## 7. ğŸŒŸ PreparedStatementæœ€ä½³å®è·µ


### 7.1 å®Œæ•´ä½¿ç”¨æ¨¡æ¿


```java
public class UserDAO {
    
    // âœ… æ¨èçš„æ ‡å‡†å†™æ³•
    public User findUserById(long id) {
        String sql = "SELECT id, name, email, age FROM users WHERE id = ?";
        
        try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
            // 1. è®¾ç½®å‚æ•°
            pstmt.setLong(1, id);
            
            // 2. æ‰§è¡ŒæŸ¥è¯¢
            try (ResultSet rs = pstmt.executeQuery()) {
                // 3. å¤„ç†ç»“æœ
                if (rs.next()) {
                    User user = new User();
                    user.setId(rs.getLong("id"));
                    user.setName(rs.getString("name"));
                    user.setEmail(rs.getString("email"));
                    user.setAge(rs.getInt("age"));
                    return user;
                }
            }
        } catch (SQLException e) {
            // 4. å¼‚å¸¸å¤„ç†
            System.err.println("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥ï¼š" + e.getMessage());
            throw new RuntimeException("æ•°æ®åº“æ“ä½œå¤±è´¥", e);
        }
        
        return null;
    }
}
```

### 7.2 æ‰¹é‡æ“ä½œä¼˜åŒ–


```java
// ğŸš€ é«˜æ•ˆçš„æ‰¹é‡æ’å…¥
public void batchInsertUsers(List<User> users) {
    String sql = "INSERT INTO users(name, email, age) VALUES(?, ?, ?)";
    
    try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
        // å…³é—­è‡ªåŠ¨æäº¤ï¼Œæé«˜æ€§èƒ½
        conn.setAutoCommit(false);
        
        for (User user : users) {
            pstmt.setString(1, user.getName());
            pstmt.setString(2, user.getEmail());
            pstmt.setInt(3, user.getAge());
            pstmt.addBatch();  // æ·»åŠ åˆ°æ‰¹å¤„ç†
            
            // æ¯1000æ¡æäº¤ä¸€æ¬¡ï¼Œé¿å…å†…å­˜æº¢å‡º
            if (users.indexOf(user) % 1000 == 0) {
                pstmt.executeBatch();
                conn.commit();
            }
        }
        
        // æ‰§è¡Œå‰©ä½™çš„æ‰¹å¤„ç†
        pstmt.executeBatch();
        conn.commit();
        
    } catch (SQLException e) {
        // å‡ºé”™æ—¶å›æ»š
        try {
            conn.rollback();
        } catch (SQLException ex) {
            ex.printStackTrace();
        }
        throw new RuntimeException("æ‰¹é‡æ’å…¥å¤±è´¥", e);
    } finally {
        // æ¢å¤è‡ªåŠ¨æäº¤
        try {
            conn.setAutoCommit(true);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

### 7.3 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**ğŸ”¸ é‡ç”¨PreparedStatementå¯¹è±¡**
```java
// âœ… å¥½çš„åšæ³•ï¼šé‡ç”¨å¯¹è±¡
String sql = "INSERT INTO logs(message, level) VALUES(?, ?)";
try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
    for (LogEntry log : logs) {
        pstmt.setString(1, log.getMessage());
        pstmt.setString(2, log.getLevel());
        pstmt.executeUpdate();
        // é‡ç”¨åŒä¸€ä¸ªPreparedStatementå¯¹è±¡
    }
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šé‡å¤åˆ›å»º
for (LogEntry log : logs) {
    String sql = "INSERT INTO logs(message, level) VALUES(?, ?)";
    PreparedStatement pstmt = conn.prepareStatement(sql);  // æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„
    // ... è¿™æ ·ä¼šå¤±å»é¢„ç¼–è¯‘çš„æ€§èƒ½ä¼˜åŠ¿
}
```

**ğŸ”¸ é€‰æ‹©åˆé€‚çš„æ‰§è¡Œæ–¹æ³•**
```java
// æ ¹æ®SQLç±»å‹é€‰æ‹©å¯¹åº”æ–¹æ³•
PreparedStatement pstmt = conn.prepareStatement(sql);

// SELECTè¯­å¥
ResultSet rs = pstmt.executeQuery();

// INSERT, UPDATE, DELETEè¯­å¥  
int affectedRows = pstmt.executeUpdate();

// ä¸ç¡®å®šSQLç±»å‹æ—¶
boolean hasResultSet = pstmt.execute();
```

### 7.4 å¸¸è§é”™è¯¯é¿å…


**âŒ é”™è¯¯1ï¼šå‚æ•°ä½ç½®æé”™**
```java
String sql = "UPDATE users SET name=?, email=? WHERE id=?";
PreparedStatement pstmt = conn.prepareStatement(sql);

// é”™è¯¯ï¼šå‚æ•°é¡ºåºä¸å¯¹
pstmt.setLong(1, id);        // åº”è¯¥æ˜¯ç¬¬3ä¸ªå‚æ•°
pstmt.setString(2, name);    // åº”è¯¥æ˜¯ç¬¬1ä¸ªå‚æ•°
pstmt.setString(3, email);   // åº”è¯¥æ˜¯ç¬¬2ä¸ªå‚æ•°
```

**âŒ é”™è¯¯2ï¼šå¿˜è®°è®¾ç½®å‚æ•°**
```java
String sql = "INSERT INTO users(name, age) VALUES(?, ?)";
PreparedStatement pstmt = conn.prepareStatement(sql);
pstmt.setString(1, "å¼ ä¸‰");
// å¿˜è®°è®¾ç½®ç¬¬2ä¸ªå‚æ•°ï¼
pstmt.executeUpdate();  // ä¼šæŠ›å‡ºå¼‚å¸¸
```

**âŒ é”™è¯¯3ï¼šä¸é‡Šæ”¾èµ„æº**
```java
// é”™è¯¯ï¼šæ²¡æœ‰å…³é—­èµ„æº
PreparedStatement pstmt = conn.prepareStatement(sql);
ResultSet rs = pstmt.executeQuery();
// å¿˜è®°å…³é—­rså’Œpstmtï¼Œå¯¼è‡´èµ„æºæ³„éœ²

// æ­£ç¡®ï¼šä½¿ç”¨try-with-resources
try (PreparedStatement pstmt = conn.prepareStatement(sql);
     ResultSet rs = pstmt.executeQuery()) {
    // è‡ªåŠ¨å…³é—­èµ„æº
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ PreparedStatementæœ¬è´¨ï¼šé¢„ç¼–è¯‘çš„SQLè¯­å¥å¯¹è±¡ï¼ŒStatementçš„å­æ¥å£
ğŸ”¸ æ ¸å¿ƒä¼˜åŠ¿ï¼šæ€§èƒ½æå‡ã€é˜²SQLæ³¨å…¥ã€ä»£ç ç®€æ´ã€æ˜“äºç»´æŠ¤
ğŸ”¸ å ä½ç¬¦æœºåˆ¶ï¼šç”¨?æ ‡è®°å‚æ•°ä½ç½®ï¼Œç¼–å·ä»1å¼€å§‹ï¼Œåªèƒ½ç”¨äºæ•°æ®å€¼
ğŸ”¸ å‚æ•°è®¾ç½®ï¼šsetXxx()æ–¹æ³•ä½“ç³»ï¼Œç±»å‹è¦åŒ¹é…æ•°æ®åº“å­—æ®µç±»å‹
ğŸ”¸ å®‰å…¨é˜²æŠ¤ï¼šé€šè¿‡é¢„ç¼–è¯‘å’Œå‚æ•°ç»‘å®šåˆ†ç¦»ï¼Œæœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥æ”»å‡»
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é¢„ç¼–è¯‘çš„æœ¬è´¨**
```
ç†è§£è¦ç‚¹ï¼š
- é¢„ç¼–è¯‘ = æå‰æŠŠSQLç¿»è¯‘æˆ"æœºå™¨è¯­è¨€"
- SQLç»“æ„ç¡®å®šåï¼Œå‚æ•°åªèƒ½ä½œä¸ºæ•°æ®ï¼Œæ— æ³•æ”¹å˜SQLé€»è¾‘
- å°±åƒæ¨¡æ¿å’Œæ•°æ®åˆ†ç¦»ï¼Œå¡«ç©ºé¢˜çš„æ ¼å¼ä¸ä¼šå› ä¸ºç­”æ¡ˆè€Œæ”¹å˜
```

**ğŸ”¹ å ä½ç¬¦çš„ä½¿ç”¨è§„åˆ™**
```
è®°å¿†è¦ç‚¹ï¼š
- ?åªèƒ½ç”¨äºæ•°æ®å€¼ï¼Œä¸èƒ½ç”¨äºè¡¨åã€å­—æ®µå
- å‚æ•°ç¼–å·ä»1å¼€å§‹ï¼ŒæŒ‰é¡ºåºè®¾ç½®
- æ¯ä¸ª?éƒ½å¿…é¡»è®¾ç½®å¯¹åº”çš„å‚æ•°å€¼
```

**ğŸ”¹ SQLæ³¨å…¥é˜²æŠ¤åŸç†**
```
æ ¸å¿ƒæœºåˆ¶ï¼š
- Statementï¼šç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°SQLä¸­(å±é™©)
- PreparedStatementï¼šç”¨æˆ·è¾“å…¥åªèƒ½ä½œä¸ºå‚æ•°å€¼(å®‰å…¨)
- ç‰¹æ®Šå­—ç¬¦è¢«è‡ªåŠ¨è½¬ä¹‰ï¼Œå¤±å»SQLè¯­æ³•æ„ä¹‰
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


- **æ€§èƒ½æå‡**ï¼šæ‰¹é‡æ“ä½œæ—¶æ€§èƒ½æå‡3-5å€
- **å®‰å…¨ä¿éšœ**ï¼šæœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥æ”»å‡»
- **ä»£ç è´¨é‡**ï¼šå‡å°‘å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä»£ç æ›´æ¸…æ™°
- **ç»´æŠ¤æ€§å¥½**ï¼šSQLç»“æ„æ¸…æ™°ï¼Œå‚æ•°ç®¡ç†æ–¹ä¾¿
- **ä¼ä¸šå¼€å‘**ï¼šå·¥ä¸šçº§åº”ç”¨çš„æ ‡å‡†åšæ³•

### 8.4 æœ€ä½³å®è·µè¦ç‚¹


```
ğŸ”¸ ä¼˜å…ˆé€‰æ‹©ï¼šé™¤éç‰¹æ®Šæƒ…å†µï¼Œéƒ½åº”è¯¥ç”¨PreparedStatement
ğŸ”¸ èµ„æºç®¡ç†ï¼šä½¿ç”¨try-with-resourcesç¡®ä¿èµ„æºå…³é—­
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šåˆç†å¤„ç†SQLExceptionï¼Œæä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
ğŸ”¸ æ‰¹é‡ä¼˜åŒ–ï¼šå¤§é‡æ•°æ®æ“ä½œæ—¶ä½¿ç”¨æ‰¹å¤„ç†æå‡æ€§èƒ½
ğŸ”¸ å‚æ•°éªŒè¯ï¼šåœ¨æ•°æ®åº“æ“ä½œå‰è¿›è¡ŒåŸºæœ¬çš„è¾“å…¥éªŒè¯
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é¢„ç¼–è¯‘ææ€§èƒ½ï¼Œå ä½ç¬¦é˜²æ³¨å…¥
- é—®å·åšå‚æ•°ï¼Œç¼–å·ä¸€å¼€å§‹  
- setXxxè®¾æ•°å€¼ï¼Œç±»å‹è¦åŒ¹é…
- å®‰å…¨åˆé«˜æ•ˆï¼Œä¼ä¸šå¼€å‘é€‰