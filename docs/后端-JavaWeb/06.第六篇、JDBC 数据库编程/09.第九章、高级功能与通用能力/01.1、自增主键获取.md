---
title: 1ã€è‡ªå¢ä¸»é”®è·å–
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯è‡ªå¢ä¸»é”®è·å–](#1-ä»€ä¹ˆæ˜¯è‡ªå¢ä¸»é”®è·å–)
2. [ä¸ºä»€ä¹ˆéœ€è¦è·å–è‡ªå¢ä¸»é”®](#2-ä¸ºä»€ä¹ˆéœ€è¦è·å–è‡ªå¢ä¸»é”®)
3. [JDBCè·å–è‡ªå¢ä¸»é”®çš„æ–¹æ³•](#3-JDBCè·å–è‡ªå¢ä¸»é”®çš„æ–¹æ³•)
4. [å•æ¡æ’å…¥è·å–è‡ªå¢ä¸»é”®](#4-å•æ¡æ’å…¥è·å–è‡ªå¢ä¸»é”®)
5. [æ‰¹é‡æ’å…¥è·å–è‡ªå¢ä¸»é”®](#5-æ‰¹é‡æ’å…¥è·å–è‡ªå¢ä¸»é”®)
6. [ä¸åŒæ•°æ®åº“çš„å·®å¼‚å¤„ç†](#6-ä¸åŒæ•°æ®åº“çš„å·®å¼‚å¤„ç†)
7. [å®é™…åº”ç”¨åœºæ™¯](#7-å®é™…åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä»€ä¹ˆæ˜¯è‡ªå¢ä¸»é”®è·å–


### 1.1 åŸºæœ¬æ¦‚å¿µç†è§£


**è‡ªå¢ä¸»é”®**å°±åƒæ˜¯é“¶è¡Œç»™ä½ åŠå¡æ—¶è‡ªåŠ¨åˆ†é…çš„å¡å·ï¼Œæ¯æ¬¡åŠæ–°å¡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç»™ä¸€ä¸ªæ–°çš„ã€ä¸é‡å¤çš„å·ç ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**
> 
> æƒ³è±¡ä½ å»åŒ»é™¢æŒ‚å·ï¼š
> - ä½ åªéœ€è¦æä¾›å§“åã€ç—‡çŠ¶ç­‰ä¿¡æ¯
> - ç³»ç»Ÿè‡ªåŠ¨ç»™ä½ åˆ†é…ä¸€ä¸ªæŒ‚å·ç¼–å·ï¼ˆæ¯”å¦‚001ã€002ã€003...ï¼‰
> - ä½ ä¸éœ€è¦è‡ªå·±æƒ³ç¼–å·ï¼Œç³»ç»Ÿä¿è¯æ¯ä¸ªäººçš„ç¼–å·éƒ½ä¸ä¸€æ ·

```sql
-- æ•°æ®åº“è¡¨ç»“æ„ç¤ºä¾‹
CREATE TABLE user (
    id INT AUTO_INCREMENT PRIMARY KEY,  -- è‡ªå¢ä¸»é”®
    name VARCHAR(50),
    age INT
);

-- æ’å…¥æ•°æ®æ—¶ä¸éœ€è¦æŒ‡å®šid
INSERT INTO user (name, age) VALUES ('å¼ ä¸‰', 25);
-- æ•°æ®åº“è‡ªåŠ¨åˆ†é…id=1

INSERT INTO user (name, age) VALUES ('æå››', 30);  
-- æ•°æ®åº“è‡ªåŠ¨åˆ†é…id=2
```

### 1.2 è‡ªå¢ä¸»é”®çš„ä½œç”¨


**ä¸»è¦ä½œç”¨ï¼š**
- **å”¯ä¸€æ ‡è¯†**ï¼šç¡®ä¿æ¯æ¡è®°å½•éƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦
- **è‡ªåŠ¨ç®¡ç†**ï¼šä¸éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†IDçš„åˆ†é…
- **é¿å…å†²çª**ï¼šå¤šç”¨æˆ·åŒæ—¶æ“ä½œä¹Ÿä¸ä¼šäº§ç”Ÿé‡å¤ID
- **ç®€åŒ–å¼€å‘**ï¼šæ’å…¥æ•°æ®æ—¶ä¸ç”¨è€ƒè™‘ä¸»é”®å€¼

---

## 2. ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦è·å–è‡ªå¢ä¸»é”®


### 2.1 å®é™…ä¸šåŠ¡éœ€æ±‚


æƒ³è±¡ä½ å¼€å‘ä¸€ä¸ª**è®¢å•ç³»ç»Ÿ**ï¼š

```
åœºæ™¯æè¿°ï¼š
ç”¨æˆ·ä¸‹å• â†’ åˆ›å»ºè®¢å•è®°å½• â†’ éœ€è¦è®¢å•IDå»åˆ›å»ºè®¢å•æ˜ç»†

æµç¨‹é—®é¢˜ï¼š
1. æ’å…¥è®¢å•ï¼šINSERT INTO order (user_id, total) VALUES (1, 100)
2. æ•°æ®åº“è‡ªåŠ¨åˆ†é…è®¢å•IDï¼ˆæ¯”å¦‚123ï¼‰
3. ä½†æ˜¯ç¨‹åºä¸çŸ¥é“è¿™ä¸ªIDæ˜¯123
4. æ— æ³•åˆ›å»ºè®¢å•æ˜ç»†ï¼šINSERT INTO order_item (order_id, ...) VALUES (?, ...)
```

> ğŸ“Œ **æ ¸å¿ƒé—®é¢˜**
> 
> æ’å…¥æ•°æ®åï¼Œç¨‹åºéœ€è¦çŸ¥é“æ•°æ®åº“è‡ªåŠ¨åˆ†é…çš„ä¸»é”®å€¼ï¼Œæ‰èƒ½è¿›è¡Œåç»­æ“ä½œ

### 2.2 å¸¸è§åº”ç”¨åœºæ™¯


| åœºæ™¯ | **è¯´æ˜** | **ä¸ºä»€ä¹ˆéœ€è¦ä¸»é”®** |
|------|----------|-------------------|
| ğŸ›’ **è®¢å•ç³»ç»Ÿ** | `åˆ›å»ºè®¢å•åéœ€è¦æ·»åŠ è®¢å•é¡¹` | `éœ€è¦è®¢å•IDå…³è”è®¢å•é¡¹` |
| ğŸ‘¤ **ç”¨æˆ·æ³¨å†Œ** | `æ³¨å†Œåéœ€è¦åˆ›å»ºç”¨æˆ·è¯¦æƒ…` | `éœ€è¦ç”¨æˆ·IDå…³è”è¯¦æƒ…è¡¨` |
| ğŸ“ **æ–‡ç« å‘å¸ƒ** | `å‘å¸ƒæ–‡ç« åéœ€è¦è®¾ç½®æ ‡ç­¾` | `éœ€è¦æ–‡ç« IDå…³è”æ ‡ç­¾è¡¨` |
| ğŸ’° **è´¢åŠ¡ç³»ç»Ÿ** | `åˆ›å»ºè´¦å•åéœ€è¦è®°å½•æµæ°´` | `éœ€è¦è´¦å•IDå…³è”æµæ°´è®°å½•` |

### 2.3 ä¸è·å–ä¸»é”®çš„é—®é¢˜


```java
// é”™è¯¯åšæ³•ç¤ºä¾‹
// 1. æ’å…¥ç”¨æˆ·
String sql1 = "INSERT INTO user (name, email) VALUES (?, ?)";
pstmt.executeUpdate(); // ç”¨æˆ·æ’å…¥æˆåŠŸï¼Œä½†ä¸çŸ¥é“ç”¨æˆ·ID

// 2. å°è¯•æ’å…¥ç”¨æˆ·è¯¦æƒ… - è¿™é‡Œå°±å¡ä½äº†
String sql2 = "INSERT INTO user_profile (user_id, phone) VALUES (?, ?)";
// é—®é¢˜ï¼šä¸çŸ¥é“åˆšæ’å…¥ç”¨æˆ·çš„IDæ˜¯å¤šå°‘ï¼
```

**ä¼ ç»Ÿçš„é”™è¯¯è§£å†³æ–¹æ³•ï¼š**
```java
// ä¸æ¨èçš„åšæ³•
// 1. å…ˆæŸ¥è¯¢æœ€å¤§ID
String maxSql = "SELECT MAX(id) FROM user";
// 2. ç”¨æœ€å¤§ID+1ä½œä¸ºæ–°IDæ’å…¥

// é—®é¢˜ï¼šåœ¨å¹¶å‘ç¯å¢ƒä¸‹å¯èƒ½è·å–åˆ°é”™è¯¯çš„IDï¼
```

---

## 3. âš™ï¸ JDBCè·å–è‡ªå¢ä¸»é”®çš„æ–¹æ³•


### 3.1 æ ¸å¿ƒAPIä»‹ç»


JDBCæä¾›äº†ä¸“é—¨çš„æ–¹æ³•æ¥è·å–è‡ªå¢ä¸»é”®ï¼Œä¸»è¦æ¶‰åŠä¸¤ä¸ªé‡è¦æ¦‚å¿µï¼š

**RETURN_GENERATED_KEYSå¸¸é‡ï¼š**
```java
// å‘Šè¯‰æ•°æ®åº“"æˆ‘è¦è·å–è‡ªå¢ä¸»é”®"
Statement.RETURN_GENERATED_KEYS
```

**getGeneratedKeys()æ–¹æ³•ï¼š**
```java
// è·å–æ•°æ®åº“ç”Ÿæˆçš„ä¸»é”®å€¼
ResultSet rs = pstmt.getGeneratedKeys();
```

> ğŸ’­ **ç”Ÿæ´»ç±»æ¯”**
> 
> å°±åƒä½ å»é“¶è¡ŒåŠå¡ï¼š
> - `RETURN_GENERATED_KEYS` = å‘Šè¯‰æŸœå‘˜"è¯·æŠŠå¡å·å‘Šè¯‰æˆ‘"
> - `getGeneratedKeys()` = æŸœå‘˜ç»™ä½ çœ‹å¡å·

### 3.2 åŸºæœ¬ä½¿ç”¨æµç¨‹


```
æ ‡å‡†æµç¨‹ï¼š
ç¬¬1æ­¥ï¼šåˆ›å»ºPreparedStatementæ—¶æŒ‡å®šRETURN_GENERATED_KEYS
ç¬¬2æ­¥ï¼šæ‰§è¡Œæ’å…¥æ“ä½œ
ç¬¬3æ­¥ï¼šè°ƒç”¨getGeneratedKeys()è·å–ç»“æœ
ç¬¬4æ­¥ï¼šä»ResultSetä¸­è¯»å–ä¸»é”®å€¼
```

**ä»£ç ç»“æ„æ¨¡æ¿ï¼š**
```java
PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
pstmt.executeUpdate();
ResultSet rs = pstmt.getGeneratedKeys();
if (rs.next()) {
    long id = rs.getLong(1); // è·å–ä¸»é”®
}
```

---

## 4. ğŸ“ å•æ¡æ’å…¥è·å–è‡ªå¢ä¸»é”®


### 4.1 å®Œæ•´ç¤ºä¾‹ä»£ç 


```java
public class AutoKeyExample {
    
    // æ’å…¥ç”¨æˆ·å¹¶è¿”å›ç”¨æˆ·ID
    public Long insertUser(String name, String email) {
        String sql = "INSERT INTO user (name, email) VALUES (?, ?)";
        
        try (PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
            
            // è®¾ç½®å‚æ•°
            pstmt.setString(1, name);
            pstmt.setString(2, email);
            
            // æ‰§è¡Œæ’å…¥
            int rowsAffected = pstmt.executeUpdate();
            
            if (rowsAffected > 0) {
                // è·å–è‡ªå¢ä¸»é”®
                ResultSet rs = pstmt.getGeneratedKeys();
                if (rs.next()) {
                    return rs.getLong(1); // è¿”å›ä¸»é”®å€¼
                }
            }
            
        } catch (SQLException e) {
            e.printStackTrace();
        }
        
        return null; // æ’å…¥å¤±è´¥
    }
}
```

### 4.2 è¯¦ç»†æ­¥éª¤è§£æ


**Step 1: å‡†å¤‡SQLè¯­å¥**
```java
String sql = "INSERT INTO user (name, email) VALUES (?, ?)";
// æ³¨æ„ï¼šSQLä¸­ä¸åŒ…å«ä¸»é”®å­—æ®µï¼Œè®©æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆ
```

**Step 2: åˆ›å»ºPreparedStatement**
```java
PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
// å…³é”®ç‚¹ï¼šç¬¬äºŒä¸ªå‚æ•°å‘Šè¯‰JDBCæˆ‘ä»¬è¦è·å–è‡ªå¢ä¸»é”®
```

**Step 3: æ‰§è¡Œå¹¶è·å–ä¸»é”®**
```java
pstmt.executeUpdate(); // æ‰§è¡Œæ’å…¥

ResultSet rs = pstmt.getGeneratedKeys(); // è·å–ç”Ÿæˆçš„ä¸»é”®
if (rs.next()) {
    long id = rs.getLong(1); // è¯»å–ç¬¬ä¸€åˆ—ï¼ˆä¸»é”®åˆ—ï¼‰
}
```

> âš ï¸ **é‡è¦æé†’**
> 
> - `getGeneratedKeys()`è¿”å›çš„ResultSetä¸­ï¼Œç¬¬ä¸€åˆ—å°±æ˜¯ä¸»é”®å€¼
> - å³ä½¿è¡¨æœ‰å¤šä¸ªåˆ—ï¼Œè¿™é‡Œä¹ŸåªåŒ…å«ç”Ÿæˆçš„é”®å€¼
> - è®°å¾—æ£€æŸ¥`rs.next()`ç¡®ä¿æœ‰æ•°æ®

### 4.3 å®é™…ä¸šåŠ¡åº”ç”¨


```java
// å®Œæ•´çš„ä¸šåŠ¡åœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œ
public boolean registerUser(String name, String email, String phone) {
    try {
        // 1. æ’å…¥ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        Long userId = insertUser(name, email);
        
        if (userId != null) {
            // 2. ä½¿ç”¨è·å–åˆ°çš„ç”¨æˆ·IDåˆ›å»ºç”¨æˆ·è¯¦æƒ…
            insertUserProfile(userId, phone);
            return true;
        }
        
    } catch (Exception e) {
        e.printStackTrace();
    }
    
    return false;
}

private void insertUserProfile(Long userId, String phone) {
    String sql = "INSERT INTO user_profile (user_id, phone) VALUES (?, ?)";
    // è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨åˆšè·å–åˆ°çš„userIdäº†
}
```

---

## 5. ğŸ“¦ æ‰¹é‡æ’å…¥è·å–è‡ªå¢ä¸»é”®


### 5.1 æ‰¹é‡æ’å…¥çš„ç‰¹æ®Šæ€§


æ‰¹é‡æ’å…¥æ—¶ï¼Œä¼šåŒæ—¶æ’å…¥å¤šæ¡è®°å½•ï¼Œæ¯æ¡è®°å½•éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªè‡ªå¢ä¸»é”®ï¼š

> ğŸ’­ **åœºæ™¯ç±»æ¯”**
> 
> å°±åƒæ‰¹é‡ç»™å­¦ç”ŸåŠå­¦ç”Ÿå¡ï¼š
> - ä¸€æ¬¡æ€§å¤„ç†10ä¸ªå­¦ç”Ÿçš„ç”³è¯·
> - æ¯ä¸ªå­¦ç”Ÿéƒ½ä¼šå¾—åˆ°ä¸åŒçš„å­¦ç”Ÿå¡å·
> - éœ€è¦çŸ¥é“æ¯ä¸ªå­¦ç”Ÿå¯¹åº”çš„å¡å·æ˜¯å¤šå°‘

### 5.2 æ‰¹é‡è·å–ä¸»é”®ä»£ç 


```java
public List<Long> batchInsertUsers(List<User> users) {
    String sql = "INSERT INTO user (name, email) VALUES (?, ?)";
    List<Long> generatedIds = new ArrayList<>();
    
    try (PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
        
        // æ·»åŠ æ‰¹é‡å‚æ•°
        for (User user : users) {
            pstmt.setString(1, user.getName());
            pstmt.setString(2, user.getEmail());
            pstmt.addBatch(); // æ·»åŠ åˆ°æ‰¹å¤„ç†
        }
        
        // æ‰§è¡Œæ‰¹é‡æ’å…¥
        pstmt.executeBatch();
        
        // è·å–æ‰€æœ‰ç”Ÿæˆçš„ä¸»é”®
        ResultSet rs = pstmt.getGeneratedKeys();
        while (rs.next()) {
            generatedIds.add(rs.getLong(1));
        }
        
    } catch (SQLException e) {
        e.printStackTrace();
    }
    
    return generatedIds;
}
```

### 5.3 æ‰¹é‡ä¸»é”®çš„ä½¿ç”¨


```java
// å®é™…åº”ç”¨ï¼šæ‰¹é‡åˆ›å»ºè®¢å•
public void createOrdersWithItems() {
    // 1. æ‰¹é‡æ’å…¥è®¢å•
    List<Long> orderIds = batchInsertOrders(orderList);
    
    // 2. ä¸ºæ¯ä¸ªè®¢å•åˆ›å»ºè®¢å•é¡¹
    for (int i = 0; i < orderIds.size(); i++) {
        Long orderId = orderIds.get(i);
        Order order = orderList.get(i);
        
        // ä½¿ç”¨è®¢å•IDåˆ›å»ºè®¢å•é¡¹
        createOrderItems(orderId, order.getItems());
    }
}
```

> ğŸ“Œ **å…³é”®ç†è§£**
> 
> æ‰¹é‡æ’å…¥æ—¶ï¼Œ`getGeneratedKeys()`è¿”å›çš„ä¸»é”®é¡ºåºä¸æ’å…¥é¡ºåºä¸€è‡´ï¼š
> - ç¬¬1æ¡æ’å…¥è®°å½•çš„ä¸»é”® = `rs.next()`ç¬¬1æ¬¡è¯»å–çš„å€¼
> - ç¬¬2æ¡æ’å…¥è®°å½•çš„ä¸»é”® = `rs.next()`ç¬¬2æ¬¡è¯»å–çš„å€¼
> - ä»¥æ­¤ç±»æ¨...

---

## 6. ğŸ”„ ä¸åŒæ•°æ®åº“çš„å·®å¼‚å¤„ç†


### 6.1 ä¸»æµæ•°æ®åº“æ”¯æŒæƒ…å†µ


| æ•°æ®åº“ | **è‡ªå¢è¯­æ³•** | **JDBCæ”¯æŒ** | **æ³¨æ„äº‹é¡¹** |
|--------|-------------|-------------|-------------|
| ğŸ¬ **MySQL** | `AUTO_INCREMENT` | âœ… å®Œå…¨æ”¯æŒ | `æœ€å¸¸ç”¨ï¼Œå…¼å®¹æ€§å¥½` |
| ğŸ˜ **PostgreSQL** | `SERIAL/IDENTITY` | âœ… å®Œå…¨æ”¯æŒ | `æ¨èä½¿ç”¨IDENTITY` |
| ğŸ¢ **SQL Server** | `IDENTITY` | âœ… å®Œå…¨æ”¯æŒ | `è¯­æ³•ç¨æœ‰ä¸åŒ` |
| ğŸ…¾ï¸ **Oracle** | `SEQUENCE` | âš ï¸ éœ€è¦é¢å¤–é…ç½® | `æ¯”è¾ƒå¤æ‚` |
| ğŸ“ **H2/SQLite** | `AUTO_INCREMENT` | âœ… å®Œå…¨æ”¯æŒ | `æµ‹è¯•ç¯å¢ƒå¸¸ç”¨` |

### 6.2 MySQL å®ç°


**è¡¨ç»“æ„ï¼š**
```sql
CREATE TABLE user (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE
);
```

**Javaä»£ç ï¼š**
```java
// MySQL - æ ‡å‡†å®ç°ï¼Œæ— ç‰¹æ®Šå¤„ç†
String sql = "INSERT INTO user (name, email) VALUES (?, ?)";
PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
```

### 6.3 PostgreSQL å®ç°


**è¡¨ç»“æ„ï¼š**
```sql
-- æ–¹å¼1ï¼šä½¿ç”¨SERIALï¼ˆæ¨èï¼‰
CREATE TABLE user (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE
);

-- æ–¹å¼2ï¼šä½¿ç”¨IDENTITYï¼ˆPostgreSQL 10+ï¼‰
CREATE TABLE user (
    id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE
);
```

**Javaä»£ç ï¼š**
```java
// PostgreSQL - ä¸MySQLç›¸åŒ
String sql = "INSERT INTO user (name, email) VALUES (?, ?)";
PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
```

### 6.4 Oracle ç‰¹æ®Šå¤„ç†


Oracleæ¯”è¾ƒç‰¹æ®Šï¼Œéœ€è¦é¢å¤–çš„é…ç½®ï¼š

**è¡¨ç»“æ„ï¼š**
```sql
-- åˆ›å»ºåºåˆ—
CREATE SEQUENCE user_seq START WITH 1 INCREMENT BY 1;

-- åˆ›å»ºè¡¨
CREATE TABLE user (
    id NUMBER PRIMARY KEY,
    name VARCHAR2(100) NOT NULL,
    email VARCHAR2(150) UNIQUE
);

-- åˆ›å»ºè§¦å‘å™¨ï¼ˆè‡ªåŠ¨å¡«å……ä¸»é”®ï¼‰
CREATE OR REPLACE TRIGGER user_trigger
    BEFORE INSERT ON user
    FOR EACH ROW
BEGIN
    :NEW.id := user_seq.NEXTVAL;
END;
```

**Javaä»£ç ï¼š**
```java
// Oracle - éœ€è¦ç‰¹æ®Šå¤„ç†
String sql = "INSERT INTO user (name, email) VALUES (?, ?)";

// æ–¹å¼1ï¼šæŒ‡å®šåˆ—å
PreparedStatement pstmt = conn.prepareStatement(sql, new String[]{"id"});

// æ–¹å¼2ï¼šå¦‚æœè§¦å‘å™¨å·²ç»å¤„ç†äº†ä¸»é”®ï¼Œä¹Ÿå¯ä»¥ç”¨æ ‡å‡†æ–¹å¼
PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
```

### 6.5 é€šç”¨å…¼å®¹æ€§å¤„ç†


```java
// æ•°æ®åº“å…¼å®¹æ€§å·¥å…·ç±»
public class DatabaseUtil {
    
    public Long insertWithGeneratedKey(Connection conn, String sql, Object... params) {
        try {
            // å°è¯•æ ‡å‡†æ–¹å¼
            return insertStandard(conn, sql, params);
        } catch (SQLException e) {
            // å¦‚æœå¤±è´¥ï¼Œå°è¯•Oracleæ–¹å¼
            return insertOracle(conn, sql, params);
        }
    }
    
    private Long insertStandard(Connection conn, String sql, Object... params) throws SQLException {
        try (PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
            // æ ‡å‡†å®ç°
            setParameters(pstmt, params);
            pstmt.executeUpdate();
            
            ResultSet rs = pstmt.getGeneratedKeys();
            return rs.next() ? rs.getLong(1) : null;
        }
    }
    
    private Long insertOracle(Connection conn, String sql, Object... params) throws SQLException {
        // Oracleç‰¹æ®Šå¤„ç†é€»è¾‘
        // ...
    }
}
```

---

## 7. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯


### 7.1 ç”µå•†è®¢å•ç³»ç»Ÿ


```java
public class OrderService {
    
    // å®Œæ•´çš„ä¸‹å•æµç¨‹
    public Long createOrder(OrderDTO orderDto) {
        try {
            // 1. åˆ›å»ºè®¢å•ä¸»è¡¨
            Long orderId = insertOrder(orderDto);
            
            if (orderId != null) {
                // 2. åˆ›å»ºè®¢å•æ˜ç»†
                for (OrderItemDTO item : orderDto.getItems()) {
                    insertOrderItem(orderId, item);
                }
                
                // 3. æ›´æ–°åº“å­˜
                updateInventory(orderDto.getItems());
                
                // 4. è®°å½•è®¢å•æ—¥å¿—
                insertOrderLog(orderId, "è®¢å•åˆ›å»ºæˆåŠŸ");
                
                return orderId;
            }
            
        } catch (Exception e) {
            // å›æ»šäº‹åŠ¡
            rollbackTransaction();
            throw new RuntimeException("ä¸‹å•å¤±è´¥", e);
        }
        
        return null;
    }
    
    private Long insertOrder(OrderDTO orderDto) {
        String sql = "INSERT INTO t_order (user_id, total_amount, status) VALUES (?, ?, ?)";
        
        try (PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
            pstmt.setLong(1, orderDto.getUserId());
            pstmt.setBigDecimal(2, orderDto.getTotalAmount());
            pstmt.setString(3, "CREATED");
            
            pstmt.executeUpdate();
            
            ResultSet rs = pstmt.getGeneratedKeys();
            return rs.next() ? rs.getLong(1) : null;
            
        } catch (SQLException e) {
            throw new RuntimeException("åˆ›å»ºè®¢å•å¤±è´¥", e);
        }
    }
}
```

### 7.2 åšå®¢æ–‡ç« ç³»ç»Ÿ


```java
public class ArticleService {
    
    // å‘å¸ƒæ–‡ç« 
    public Long publishArticle(ArticleDTO articleDto) {
        // 1. æ’å…¥æ–‡ç« ä¸»ä½“
        Long articleId = insertArticle(articleDto);
        
        if (articleId != null) {
            // 2. å¤„ç†æ–‡ç« æ ‡ç­¾
            batchInsertTags(articleId, articleDto.getTags());
            
            // 3. å¤„ç†æ–‡ç« åˆ†ç±»
            insertArticleCategory(articleId, articleDto.getCategoryId());
            
            return articleId;
        }
        
        return null;
    }
    
    private void batchInsertTags(Long articleId, List<String> tags) {
        String sql = "INSERT INTO article_tag (article_id, tag_name) VALUES (?, ?)";
        
        try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
            for (String tag : tags) {
                pstmt.setLong(1, articleId);  // ä½¿ç”¨è·å–åˆ°çš„æ–‡ç« ID
                pstmt.setString(2, tag);
                pstmt.addBatch();
            }
            pstmt.executeBatch();
            
        } catch (SQLException e) {
            throw new RuntimeException("æ·»åŠ æ ‡ç­¾å¤±è´¥", e);
        }
    }
}
```

### 7.3 ç”¨æˆ·æ³¨å†Œç³»ç»Ÿ


```java
public class UserService {
    
    // å®Œæ•´ç”¨æˆ·æ³¨å†Œ
    public UserVO registerUser(UserRegistrationDTO dto) {
        try {
            // å¼€å¯äº‹åŠ¡
            conn.setAutoCommit(false);
            
            // 1. åˆ›å»ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯
            Long userId = insertUser(dto);
            
            // 2. åˆ›å»ºç”¨æˆ·é…ç½®ä¿¡æ¯
            insertUserProfile(userId, dto);
            
            // 3. åˆ›å»ºç”¨æˆ·é’±åŒ…
            insertUserWallet(userId);
            
            // 4. å‘é€æ¬¢è¿é‚®ä»¶
            sendWelcomeEmail(userId, dto.getEmail());
            
            // æäº¤äº‹åŠ¡
            conn.commit();
            
            return buildUserVO(userId, dto);
            
        } catch (Exception e) {
            // å›æ»šäº‹åŠ¡
            try {
                conn.rollback();
            } catch (SQLException ex) {
                ex.printStackTrace();
            }
            throw new RuntimeException("ç”¨æˆ·æ³¨å†Œå¤±è´¥", e);
        } finally {
            try {
                conn.setAutoCommit(true);
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è‡ªå¢ä¸»é”®ï¼šæ•°æ®åº“è‡ªåŠ¨åˆ†é…çš„å”¯ä¸€æ ‡è¯†ç¬¦
ğŸ”¸ RETURN_GENERATED_KEYSï¼šå‘Šè¯‰JDBCè·å–ç”Ÿæˆçš„ä¸»é”®
ğŸ”¸ getGeneratedKeys()ï¼šè·å–æ•°æ®åº“ç”Ÿæˆçš„ä¸»é”®å€¼
ğŸ”¸ ä¸šåŠ¡åº”ç”¨ï¼šä¸»å­è¡¨å…³è”ã€äº‹åŠ¡å¤„ç†çš„åŸºç¡€
ğŸ”¸ æ‰¹é‡å¤„ç†ï¼šå¤šæ¡è®°å½•åŒæ—¶è·å–å¤šä¸ªä¸»é”®å€¼
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è·å–è‡ªå¢ä¸»é”®**
```
å®é™…éœ€æ±‚ï¼š
- ä¸»å­è¡¨å…³è”éœ€è¦ä¸»è¡¨ID
- åç»­ä¸šåŠ¡é€»è¾‘éœ€è¦è®°å½•ID
- äº‹åŠ¡å¤„ç†éœ€è¦å‡†ç¡®çš„è®°å½•æ ‡è¯†
- é¿å…å¹¶å‘ç¯å¢ƒä¸‹çš„IDå†²çª
```

**ğŸ”¹ ä½¿ç”¨æ­¥éª¤çš„æ ‡å‡†æµç¨‹**
```
æ ‡å‡†æµç¨‹ï¼š
Step 1: prepareStatement(sql, RETURN_GENERATED_KEYS)
Step 2: è®¾ç½®å‚æ•°å¹¶æ‰§è¡ŒexecuteUpdate()
Step 3: è°ƒç”¨getGeneratedKeys()è·å–ResultSet
Step 4: ä»ResultSetè¯»å–ä¸»é”®å€¼
```

**ğŸ”¹ å¸¸è§æ³¨æ„äº‹é¡¹**
```
é‡è¦ç»†èŠ‚ï¼š
- SQLè¯­å¥ä¸­ä¸è¦åŒ…å«ä¸»é”®å­—æ®µ
- æ£€æŸ¥executeUpdate()çš„è¿”å›å€¼
- ç¡®ä¿è°ƒç”¨rs.next()æ£€æŸ¥æ•°æ®å­˜åœ¨
- æ‰¹é‡æ“ä½œæ—¶ä¸»é”®é¡ºåºä¸æ’å…¥é¡ºåºä¸€è‡´
- ä¸åŒæ•°æ®åº“å¯èƒ½æœ‰è¯­æ³•å·®å¼‚
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ä¸šåŠ¡åœºæ™¯åº”ç”¨ï¼š**
- **ç”µå•†ç³»ç»Ÿ**ï¼šè®¢å•åˆ›å»ºåéœ€è¦åˆ›å»ºè®¢å•æ˜ç»†
- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šç”¨æˆ·æ³¨å†Œåéœ€è¦åˆ›å»ºç”¨æˆ·è¯¦æƒ…
- **å†…å®¹ç®¡ç†**ï¼šæ–‡ç« å‘å¸ƒåéœ€è¦å¤„ç†æ ‡ç­¾å’Œåˆ†ç±»
- **è´¢åŠ¡ç³»ç»Ÿ**ï¼šè´¦å•åˆ›å»ºåéœ€è¦è®°å½•æµæ°´æ˜ç»†

**æŠ€æœ¯ä»·å€¼ï¼š**
- **æ•°æ®ä¸€è‡´æ€§**ï¼šä¿è¯ä¸»å­è¡¨æ•°æ®çš„æ­£ç¡®å…³è”
- **äº‹åŠ¡å®Œæ•´æ€§**ï¼šæ”¯æŒå®Œæ•´çš„ä¸šåŠ¡äº‹åŠ¡å¤„ç†
- **å¹¶å‘å®‰å…¨æ€§**ï¼šé¿å…å¤šç”¨æˆ·æ“ä½œæ—¶çš„IDå†²çª
- **å¼€å‘æ•ˆç‡**ï¼šç®€åŒ–ä¸»é”®ç®¡ç†ï¼Œå‡å°‘é¢å¤–æŸ¥è¯¢

### 8.4 æœ€ä½³å®è·µå»ºè®®


```java
// æ¨èçš„ä»£ç æ¨¡æ¿
public Long insertRecord(/* å‚æ•° */) {
    String sql = "INSERT INTO table_name (col1, col2) VALUES (?, ?)";
    
    try (PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
        // è®¾ç½®å‚æ•°
        pstmt.setString(1, value1);
        pstmt.setString(2, value2);
        
        // æ‰§è¡Œæ’å…¥
        int rowsAffected = pstmt.executeUpdate();
        
        if (rowsAffected > 0) {
            ResultSet rs = pstmt.getGeneratedKeys();
            if (rs.next()) {
                return rs.getLong(1);
            }
        }
        
    } catch (SQLException e) {
        // å¼‚å¸¸å¤„ç†
        logger.error("æ’å…¥è®°å½•å¤±è´¥", e);
        throw new RuntimeException("æ“ä½œå¤±è´¥", e);
    }
    
    return null;
}
```

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
- æ’å…¥ä¹‹å‰å‘Šè¯‰JDBCè¦ä¸»é”®
- æ‰§è¡Œä¹‹åè°ƒç”¨æ–¹æ³•å–ä¸»é”®  
- æ£€æŸ¥ç»“æœé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸
- ä¸»å­å…³è”å…¨é è¿™ä¸ªä¸»é”®

**å­¦ä¹ å»ºè®®ï¼š**
- å¤šåšå®é™…é¡¹ç›®ç»ƒä¹ ï¼Œç†è§£ä¸šåŠ¡åœºæ™¯
- æµ‹è¯•ä¸åŒæ•°æ®åº“çš„å…¼å®¹æ€§
- å…³æ³¨å¼‚å¸¸å¤„ç†å’Œäº‹åŠ¡ç®¡ç†
- ç»“åˆå®é™…ä¸šåŠ¡ç†è§£åº”ç”¨ä»·å€¼