---
title: 3ã€HikariCPé…ç½®ä¸ä½¿ç”¨
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯HikariCPè¿æ¥æ± ](#1-ä»€ä¹ˆæ˜¯hikaricpè¿æ¥æ± )
2. [ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± æŠ€æœ¯](#2-ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± æŠ€æœ¯)
3. [HikariCPæ ¸å¿ƒé…ç½®è¯¦è§£](#3-hikaricpæ ¸å¿ƒé…ç½®è¯¦è§£)
4. [HikariCPä½¿ç”¨å®æˆ˜](#4-hikaricpä½¿ç”¨å®æˆ˜)
5. [è¿æ¥æ³„æ¼æ£€æµ‹ä¸è°ƒä¼˜](#5-è¿æ¥æ³„æ¼æ£€æµ‹ä¸è°ƒä¼˜)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŠâ€â™‚ï¸ ä»€ä¹ˆæ˜¯HikariCPè¿æ¥æ± 


### 1.1 è¿æ¥æ± çš„é€šä¿—ç†è§£


> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> HikariCPå°±åƒä¸€ä¸ª"æ•°æ®åº“è¿æ¥çš„æ¸¸æ³³æ± "ï¼Œæå‰å‡†å¤‡å¥½å¤šä¸ªè¿æ¥ï¼Œéœ€è¦æ—¶ç›´æ¥å–ç”¨ï¼Œç”¨å®Œåå½’è¿˜ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥çš„å¼€é”€ã€‚

**ç”Ÿæ´»åŒ–ç±»æ¯”**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ = æ¯æ¬¡å»é“¶è¡Œéƒ½è¦é‡æ–°åŠå¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠæ–°å¡  â”‚ â†’  â”‚ ä¸šåŠ¡åŠç† â”‚ â†’  â”‚ é”€æ¯å¡  â”‚
â”‚ (è€—æ—¶)  â”‚    â”‚ (æ ¸å¿ƒ)  â”‚    â”‚ (è€—æ—¶)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿æ¥æ± æ–¹å¼ = é“¶è¡Œå‡†å¤‡å¤šå¼ å¯é‡å¤ä½¿ç”¨çš„å¡
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ è¿æ¥æ± (å¡æ± )     â”‚
     â”‚ â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”‚
     â”‚ â”‚å¡â”‚ â”‚å¡â”‚ â”‚å¡â”‚ â”‚å¡â”‚ â”‚
     â”‚ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“ å–å¡    â†‘ è¿˜å¡
   åŠç†ä¸šåŠ¡    åŠç†å®Œæˆ
```

### 1.2 HikariCPçš„ç‰¹ç‚¹


**ğŸš€ æ€§èƒ½ç‰¹ç‚¹**ï¼š
- **æé€Ÿ**ï¼šç›®å‰æœ€å¿«çš„Javaè¿æ¥æ± 
- **è½»é‡**ï¼šä»£ç ç®€æ´ï¼ŒjaråŒ…åªæœ‰130KB
- **ç¨³å®š**ï¼šSpring Boot 2.0+é»˜è®¤è¿æ¥æ± 

**ğŸ”§ æŠ€æœ¯ä¼˜åŠ¿**ï¼š
```
ä¼ ç»Ÿè¿æ¥æ± é—®é¢˜ï¼š
â”œâ”€â”€ è¿æ¥åˆ›å»ºæ…¢ â†’ HikariCPï¼šå¿«é€Ÿè¿æ¥åˆ›å»º
â”œâ”€â”€ å†…å­˜å ç”¨å¤§ â†’ HikariCPï¼šä¼˜åŒ–çš„å†…å­˜ä½¿ç”¨
â”œâ”€â”€ é…ç½®å¤æ‚   â†’ HikariCPï¼šæ™ºèƒ½é»˜è®¤é…ç½®
â””â”€â”€ ç›‘æ§ä¸è¶³   â†’ HikariCPï¼šå®Œå–„çš„ç›‘æ§æŒ‡æ ‡
```

---

## 2. ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± æŠ€æœ¯


### 2.1 æ²¡æœ‰è¿æ¥æ± çš„é—®é¢˜


**ä¼ ç»Ÿæ–¹å¼çš„æ€§èƒ½é—®é¢˜**ï¼š
```
æ¯æ¬¡æ•°æ®åº“æ“ä½œæµç¨‹ï¼š
1. å»ºç«‹TCPè¿æ¥        â† ç½‘ç»œæ¡æ‰‹(100-200ms)
2. æ•°æ®åº“è®¤è¯         â† ç”¨æˆ·åå¯†ç éªŒè¯(50-100ms)  
3. æ‰§è¡ŒSQLè¯­å¥        â† çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘(10ms)
4. å…³é—­è¿æ¥          â† èµ„æºæ¸…ç†(50ms)

æ€»è€—æ—¶ï¼š210-360msï¼Œå…¶ä¸­ä¸šåŠ¡é€»è¾‘åªå 3%ï¼
```

> âš ï¸ **æ€§èƒ½é—®é¢˜**  
> åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ¯ç§’1000ä¸ªè¯·æ±‚æ„å‘³ç€æ¯ç§’è¦åˆ›å»ºå’Œé”€æ¯1000ä¸ªæ•°æ®åº“è¿æ¥ï¼ŒæœåŠ¡å™¨å¾ˆå¿«å°±ä¼šè¢«å‹å®ã€‚

### 2.2 è¿æ¥æ± è§£å†³æ–¹æ¡ˆ


**è¿æ¥æ± çš„å·¥ä½œåŸç†**ï¼š
```
è¿æ¥æ± å·¥ä½œæµç¨‹ï¼š
1. ç³»ç»Ÿå¯åŠ¨æ—¶é¢„åˆ›å»ºè¿æ¥      â† ä¸€æ¬¡æ€§æˆæœ¬
2. ç”¨æˆ·è¯·æ±‚æ—¶å€Ÿç”¨è¿æ¥        â† å‡ ä¹é›¶æˆæœ¬(<1ms)
3. æ‰§è¡ŒSQLè¯­å¥              â† ä¸šåŠ¡é€»è¾‘(10ms)
4. å½’è¿˜è¿æ¥åˆ°æ± ä¸­           â† å‡ ä¹é›¶æˆæœ¬(<1ms)

æ€»è€—æ—¶ï¼šçº¦11msï¼Œæ€§èƒ½æå‡20-30å€ï¼
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”**ï¼š

| å¯¹æ¯”é¡¹ç›® | **ä¼ ç»Ÿæ–¹å¼** | **è¿æ¥æ± æ–¹å¼** | **æå‡æ•ˆæœ** |
|---------|-------------|---------------|-------------|
| ğŸ• å“åº”æ—¶é—´ | 200-300ms | 10-20ms | âš¡ **15å€æå‡** |
| ğŸ”¢ å¹¶å‘é‡ | 100ç”¨æˆ· | 2000+ç”¨æˆ· | ğŸš€ **20å€æå‡** |
| ğŸ’¾ å†…å­˜ä½¿ç”¨ | ä¸ç¨³å®š | å¯æ§åˆ¶ | ğŸ¯ **ç¨³å®šå¯æ§** |
| ğŸ¥ ç³»ç»Ÿç¨³å®šæ€§ | å®¹æ˜“å´©æºƒ | é«˜ç¨³å®šæ€§ | âœ… **æ˜¾è‘—æ”¹å–„** |

---

## 3. âš™ï¸ HikariCPæ ¸å¿ƒé…ç½®è¯¦è§£


### 3.1 æœ€é‡è¦çš„æ ¸å¿ƒé…ç½®


> ğŸ’¡ **æ–°æ‰‹æé†’**  
> è¿™5ä¸ªé…ç½®å‚æ•°æ˜¯HikariCPçš„æ ¸å¿ƒï¼Œç†è§£äº†å®ƒä»¬å°±æŒæ¡äº†80%çš„è¿æ¥æ± çŸ¥è¯†ã€‚

```java
// æ ¸å¿ƒé…ç½®ç¤ºä¾‹
HikariConfig config = new HikariConfig();

// 1. æœ€å¤§è¿æ¥æ•°(æœ€é‡è¦)
config.setMaximumPoolSize(20);        // æ± ä¸­æœ€å¤š20ä¸ªè¿æ¥

// 2. æœ€å°ç©ºé—²è¿æ¥æ•°  
config.setMinimumIdle(5);             // æ± ä¸­è‡³å°‘ä¿æŒ5ä¸ªè¿æ¥

// 3. è¿æ¥è¶…æ—¶æ—¶é—´
config.setConnectionTimeout(30000);   // 30ç§’è·å–ä¸åˆ°è¿æ¥å°±æŠ¥é”™

// 4. æ•°æ®åº“è¿æ¥ä¿¡æ¯
config.setJdbcUrl("jdbc:mysql://localhost:3306/demo");
config.setUsername("root");
config.setPassword("123456");
```

### 3.2 maximumPoolSize - æœ€å¤§è¿æ¥æ•°


**ğŸ”¸ æ¦‚å¿µè§£é‡Š**ï¼š
```
maximumPoolSize = è¿æ¥æ± çš„"å®¹é‡ä¸Šé™"

å°±åƒåœè½¦åœºæœ€å¤šèƒ½åœå¤šå°‘è¾†è½¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿æ¥æ±  (maximumPoolSize=10) â”‚
â”‚ â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”‚
â”‚ â”‚è¿â”‚ â”‚è¿â”‚ â”‚è¿â”‚ â”‚è¿â”‚ â”‚è¿â”‚ â”‚ â† æ­£åœ¨ä½¿ç”¨
â”‚ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”‚
â”‚ â”‚è¿â”‚ â”‚è¿â”‚ â”‚è¿â”‚ â”‚è¿â”‚ â”‚è¿â”‚ â”‚ â† ç©ºé—²å¾…ç”¨
â”‚ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš–ï¸ è®¾ç½®åŸåˆ™**ï¼š
- **å¤ªå°**ï¼šå¹¶å‘é«˜æ—¶ç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿
- **å¤ªå¤§**ï¼šæµªè´¹æ•°æ®åº“èµ„æºï¼Œå¯èƒ½å‹å®æ•°æ®åº“
- **ç»éªŒå€¼**ï¼šCPUæ ¸å¿ƒæ•° Ã— 2 åˆ° CPUæ ¸å¿ƒæ•° Ã— 4

```java
// å®é™…é…ç½®å»ºè®®
int cpuCores = Runtime.getRuntime().availableProcessors(); // è·å–CPUæ ¸å¿ƒæ•°
config.setMaximumPoolSize(cpuCores * 2);  // ä¿å®ˆé…ç½®
// config.setMaximumPoolSize(cpuCores * 4);  // æ¿€è¿›é…ç½®
```

### 3.3 minimumIdle - æœ€å°ç©ºé—²è¿æ¥


**ğŸ”¸ æ¦‚å¿µè§£é‡Š**ï¼š
```
minimumIdle = è¿æ¥æ± çš„"ä¿åº•åº“å­˜"

å°±åƒé¥­åº—è‡³å°‘è¦å‡†å¤‡å‡ æ¡Œç©ºæ¡Œï¼š
è¿æ¥ä½¿ç”¨æƒ…å†µå˜åŒ–ï¼š
å¿™æ—¶ï¼šâ”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â† 6ä¸ªéƒ½åœ¨ç”¨
     â”‚å¿™â”‚ â”‚å¿™â”‚ â”‚å¿™â”‚ â”‚å¿™â”‚ â”‚å¿™â”‚ â”‚å¿™â”‚
     â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜

é—²æ—¶ï¼šâ”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â† 2ä¸ªåœ¨ç”¨ï¼Œ4ä¸ªç©ºé—²
     â”‚å¿™â”‚ â”‚å¿™â”‚ â”‚é—²â”‚ â”‚é—²â”‚ â”‚é—²â”‚ â”‚é—²â”‚   ä½†minimumIdle=4ï¼Œ
     â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜   è‡³å°‘ä¿æŒ4ä¸ª
```

**âš–ï¸ è®¾ç½®å»ºè®®**ï¼š
- **ä¸€èˆ¬è®¾ç½®**ï¼šmaximumPoolSizeçš„30%-50%
- **é«˜å¹¶å‘ç³»ç»Ÿ**ï¼šè®¾ç½®å¾—ç¨é«˜ï¼Œä¿è¯å“åº”é€Ÿåº¦
- **èµ„æºç´§å¼ **ï¼šå¯ä»¥è®¾ç½®å¾—å¾ˆå°ï¼Œç”šè‡³ä¸º0

### 3.4 connectionTimeout - è¿æ¥è¶…æ—¶


**ğŸ”¸ æ¦‚å¿µè§£é‡Š**ï¼š
```
connectionTimeout = è·å–è¿æ¥çš„"ç­‰å¾…æ—¶é™"

å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥çš„ç­‰å¾…è¿‡ç¨‹ï¼š
æ—¶é—´: 0ms    10s     20s    30s
     â”‚-------â”‚-------â”‚------â”‚
     å¼€å§‹ç­‰å¾…  ç»§ç»­ç­‰å¾…  è¿˜åœ¨ç­‰  è¶…æ—¶æŠ¥é”™ï¼
     
å¦‚æœ30ç§’å†…æ‹¿ä¸åˆ°è¿æ¥ï¼Œå°±æŠ›å‡ºå¼‚å¸¸
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```java
// ç”¨æˆ·ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®
try {
    Connection conn = dataSource.getConnection(); // å¦‚æœ30ç§’å†…æ‹¿ä¸åˆ°è¿æ¥
    // æ‰§è¡ŒæŸ¥è¯¢...
} catch (SQLTimeoutException e) {
    // å‘ç”¨æˆ·æ˜¾ç¤ºï¼šç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•
    return "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•";
}
```

### 3.5 å®Œæ•´é…ç½®ç¤ºä¾‹


```java
// ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
public class HikariCPConfig {
    
    public static HikariDataSource createDataSource() {
        HikariConfig config = new HikariConfig();
        
        // åŸºç¡€è¿æ¥ä¿¡æ¯
        config.setJdbcUrl("jdbc:mysql://localhost:3306/demo?useSSL=false");
        config.setUsername("root");
        config.setPassword("123456");
        config.setDriverClassName("com.mysql.cj.jdbc.Driver");
        
        // è¿æ¥æ± æ ¸å¿ƒé…ç½®
        config.setMaximumPoolSize(20);          // æœ€å¤§è¿æ¥æ•°
        config.setMinimumIdle(5);               // æœ€å°ç©ºé—²è¿æ¥
        config.setConnectionTimeout(30000);     // è·å–è¿æ¥è¶…æ—¶(30ç§’)
        
        // è¿æ¥ç”Ÿå‘½å‘¨æœŸé…ç½®
        config.setMaxLifetime(1800000);         // è¿æ¥æœ€å¤§å­˜æ´»æ—¶é—´(30åˆ†é’Ÿ)
        config.setIdleTimeout(600000);          // ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´(10åˆ†é’Ÿ)
        
        return new HikariDataSource(config);
    }
}
```

---

## 4. ğŸ› ï¸ HikariCPä½¿ç”¨å®æˆ˜


### 4.1 Spring Booté›†æˆé…ç½®


**application.propertiesé…ç½®**ï¼š
```properties
# æ•°æ®åº“è¿æ¥åŸºæœ¬ä¿¡æ¯
spring.datasource.url=jdbc:mysql://localhost:3306/demo
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCPè¿æ¥æ± é…ç½®
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=MyHikariPool
```

> ğŸ“Œ **Spring Bootä¼˜åŠ¿**  
> Spring Boot 2.0+é»˜è®¤å°±ä½¿ç”¨HikariCPï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ åªéœ€è¦é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œå…¶ä»–å‚æ•°éƒ½æœ‰æ™ºèƒ½é»˜è®¤å€¼ã€‚

### 4.2 ä¼ ç»ŸJavaé¡¹ç›®ä½¿ç”¨


```java
public class DatabaseManager {
    private static HikariDataSource dataSource;
    
    // åˆå§‹åŒ–è¿æ¥æ± (ç¨‹åºå¯åŠ¨æ—¶è°ƒç”¨ä¸€æ¬¡)
    static {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/demo");
        config.setUsername("root");
        config.setPassword("123456");
        config.setMaximumPoolSize(10);
        
        dataSource = new HikariDataSource(config);
    }
    
    // è·å–è¿æ¥çš„æ–¹æ³•
    public static Connection getConnection() throws SQLException {
        return dataSource.getConnection();
    }
    
    // å…³é—­è¿æ¥æ± (ç¨‹åºç»“æŸæ—¶è°ƒç”¨)
    public static void close() {
        if (dataSource != null && !dataSource.isClosed()) {
            dataSource.close();
        }
    }
}
```

### 4.3 å®é™…ä½¿ç”¨ç¤ºä¾‹


```java
public class UserDao {
    
    public List<User> findAllUsers() {
        List<User> users = new ArrayList<>();
        
        // ä½¿ç”¨try-with-resourcesè‡ªåŠ¨å…³é—­èµ„æº
        String sql = "SELECT id, name, email FROM users";
        try (Connection conn = DatabaseManager.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql);
             ResultSet rs = stmt.executeQuery()) {
            
            while (rs.next()) {
                User user = new User();
                user.setId(rs.getInt("id"));
                user.setName(rs.getString("name"));
                user.setEmail(rs.getString("email"));
                users.add(user);
            }
            
        } catch (SQLException e) {
            e.printStackTrace();
        }
        
        return users;
    }
}
```

> ğŸ’¡ **é‡è¦æé†’**  
> ä½¿ç”¨è¿æ¥æ± æ—¶ï¼Œ`Connection.close()`ä¸æ˜¯çœŸæ­£å…³é—­è¿æ¥ï¼Œè€Œæ˜¯æŠŠè¿æ¥å½’è¿˜ç»™è¿æ¥æ± ã€‚è¿™æ˜¯è¿æ¥æ± çš„"é­”æ³•"æ‰€åœ¨ï¼

---

## 5. ğŸ” è¿æ¥æ³„æ¼æ£€æµ‹ä¸è°ƒä¼˜


### 5.1 ä»€ä¹ˆæ˜¯è¿æ¥æ³„æ¼


**ğŸ”¸ è¿æ¥æ³„æ¼çš„æ¦‚å¿µ**ï¼š
```
è¿æ¥æ³„æ¼ = å€Ÿäº†è¿æ¥ä¸å½’è¿˜

æ­£å¸¸æµç¨‹ï¼š
è·å–è¿æ¥ â†’ ä½¿ç”¨è¿æ¥ â†’ å½’è¿˜è¿æ¥ âœ…

æ³„æ¼æµç¨‹ï¼š  
è·å–è¿æ¥ â†’ ä½¿ç”¨è¿æ¥ â†’ å¿˜è®°å½’è¿˜ âŒ

ç»“æœï¼šè¿æ¥æ± ä¸­çš„è¿æ¥è¶Šæ¥è¶Šå°‘ï¼Œæœ€ç»ˆè€—å°½
```

**å…¸å‹çš„æ³„æ¼ä»£ç **ï¼š
```java
// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå¯èƒ½é€ æˆè¿æ¥æ³„æ¼
public void badExample() {
    try {
        Connection conn = dataSource.getConnection();
        PreparedStatement stmt = conn.prepareStatement("SELECT * FROM users");
        ResultSet rs = stmt.executeQuery();
        
        // å¦‚æœè¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿æ¥å°±ä¸ä¼šè¢«å…³é—­ï¼
        if (rs.next()) {
            throw new RuntimeException("æŸä¸ªä¸šåŠ¡å¼‚å¸¸");
        }
        
        rs.close();
        stmt.close();
        conn.close(); // è¿™è¡Œä»£ç å¯èƒ½æ‰§è¡Œä¸åˆ°
        
    } catch (SQLException e) {
        e.printStackTrace();
    }
}
```

### 5.2 HikariCPæ³„æ¼æ£€æµ‹é…ç½®


```java
HikariConfig config = new HikariConfig();

// å¼€å¯æ³„æ¼æ£€æµ‹
config.setLeakDetectionThreshold(60000);  // 60ç§’æœªå½’è¿˜å°±è®¤ä¸ºæ³„æ¼

// è®¾ç½®è¿æ¥æµ‹è¯•æŸ¥è¯¢
config.setConnectionTestQuery("SELECT 1");

// è¿æ¥æ± åç§°ï¼Œä¾¿äºç›‘æ§
config.setPoolName("MyHikariPool");
```

**æ³„æ¼æ£€æµ‹å·¥ä½œåŸç†**ï¼š
```
è¿æ¥å€Ÿå‡ºè®°å½•ï¼š
æ—¶é—´    æ“ä½œ              çŠ¶æ€
10:00   å€Ÿå‡ºè¿æ¥A         æ­£å¸¸ä½¿ç”¨ä¸­
10:30   å€Ÿå‡ºè¿æ¥B         æ­£å¸¸ä½¿ç”¨ä¸­  
10:31   å½’è¿˜è¿æ¥B         âœ… æ­£å¸¸å½’è¿˜
11:01   æ£€æµ‹è¿æ¥A         âš ï¸ è¶…è¿‡60ç§’æœªå½’è¿˜ï¼Œè®°å½•æ³„æ¼æ—¥å¿—
```

### 5.3 é˜²æ­¢è¿æ¥æ³„æ¼çš„æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•ï¼štry-with-resources**
```java
// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šä¿è¯è¿æ¥ä¸€å®šè¢«å½’è¿˜
public List<User> goodExample() {
    List<User> users = new ArrayList<>();
    
    String sql = "SELECT id, name, email FROM users";
    
    // try-with-resourcesä¼šè‡ªåŠ¨å…³é—­èµ„æº
    try (Connection conn = dataSource.getConnection();
         PreparedStatement stmt = conn.prepareStatement(sql);
         ResultSet rs = stmt.executeQuery()) {
        
        while (rs.next()) {
            User user = new User();
            user.setId(rs.getInt("id"));
            user.setName(rs.getString("name"));
            user.setEmail(rs.getString("email"));
            users.add(user);
        }
        
        // å³ä½¿è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿æ¥ä¹Ÿä¼šè¢«è‡ªåŠ¨å½’è¿˜
        
    } catch (SQLException e) {
        e.printStackTrace();
    }
    
    return users;
}
```

### 5.4 è¿æ¥æ± ç›‘æ§ä¸è°ƒä¼˜


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

| ç›‘æ§æŒ‡æ ‡ | **å«ä¹‰** | **æ­£å¸¸èŒƒå›´** | **å¼‚å¸¸å¤„ç†** |
|---------|---------|-------------|-------------|
| `ActiveConnections` | æ­£åœ¨ä½¿ç”¨çš„è¿æ¥æ•° | < 80% max | è€ƒè™‘å¢åŠ è¿æ¥æ•° |
| `IdleConnections` | ç©ºé—²è¿æ¥æ•° | > 10% max | è°ƒæ•´minimumIdle |
| `WaitingThreads` | ç­‰å¾…è¿æ¥çš„çº¿ç¨‹æ•° | æ¥è¿‘0 | å¢åŠ è¿æ¥æˆ–ä¼˜åŒ–SQL |
| `ConnectionCreations` | è¿æ¥åˆ›å»ºé€Ÿç‡ | ä½é¢‘ç‡ | æ£€æŸ¥è¿æ¥é…ç½® |

**æ€§èƒ½è°ƒä¼˜å»ºè®®**ï¼š
```java
// æ ¹æ®åº”ç”¨ç‰¹ç‚¹è°ƒä¼˜
HikariConfig config = new HikariConfig();

// Webåº”ç”¨ï¼ˆçŸ­è¿æ¥ï¼Œé«˜å¹¶å‘ï¼‰
config.setMaximumPoolSize(50);           // é€‚å½“å¢å¤§
config.setMinimumIdle(10);               // ä¿æŒä¸€å®šç©ºé—²
config.setConnectionTimeout(5000);       // å¿«é€Ÿå¤±è´¥
config.setIdleTimeout(300000);           // è¾ƒçŸ­çš„ç©ºé—²æ—¶é—´

// æ‰¹å¤„ç†åº”ç”¨ï¼ˆé•¿è¿æ¥ï¼Œä½å¹¶å‘ï¼‰  
config.setMaximumPoolSize(10);           // è¾ƒå°è¿æ¥æ•°
config.setMinimumIdle(2);                // æœ€å°‘ç©ºé—²
config.setConnectionTimeout(30000);      // è¾ƒé•¿ç­‰å¾…æ—¶é—´
config.setMaxLifetime(3600000);          // è¾ƒé•¿ç”Ÿå‘½å‘¨æœŸ
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> ğŸ“Œ **HikariCPæœ¬è´¨**  
> HikariCPæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå®ƒé¢„å…ˆåˆ›å»ºå¹¶ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œè®©åº”ç”¨ç¨‹åºå¯ä»¥å¿«é€Ÿè·å–å’Œå½’è¿˜è¿æ¥ï¼Œå¤§å¹…æå‡æ•°æ®åº“è®¿é—®æ€§èƒ½ã€‚

**ğŸ”¸ æ ¸å¿ƒé…ç½®è¦ç‚¹**ï¼š
```
maximumPoolSizeï¼šè¿æ¥æ± æœ€å¤§å®¹é‡ï¼Œå†³å®šå¹¶å‘èƒ½åŠ›
minimumIdleï¼šæœ€å°ç©ºé—²è¿æ¥æ•°ï¼Œä¿è¯å“åº”é€Ÿåº¦  
connectionTimeoutï¼šè·å–è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé¿å…æ— é™ç­‰å¾…
leakDetectionThresholdï¼šè¿æ¥æ³„æ¼æ£€æµ‹ï¼Œä¿è¯ç³»ç»Ÿç¨³å®š
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¿æ¥æ± è¿™ä¹ˆé‡è¦**ï¼š
```
æ€§èƒ½æå‡ï¼šå“åº”æ—¶é—´ä»300msé™åˆ°10msï¼Œæå‡30å€
èµ„æºæ§åˆ¶ï¼šé™åˆ¶æœ€å¤§è¿æ¥æ•°ï¼Œä¿æŠ¤æ•°æ®åº“ä¸è¢«å‹å®
ç¨³å®šæ€§ï¼šè¿æ¥å¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¼€é”€
```

**ğŸ”¹ é…ç½®å‚æ•°çš„æƒè¡¡**ï¼š
```
è¿æ¥æ•°è®¾ç½®ï¼š
- å¤ªå°‘ï¼šç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿ï¼Œå¹¶å‘èƒ½åŠ›å·®
- å¤ªå¤šï¼šæ•°æ®åº“å‹åŠ›å¤§ï¼Œå†…å­˜æ¶ˆè€—å¤š
- åˆé€‚ï¼šæ ¹æ®CPUæ ¸å¿ƒæ•°å’Œå®é™…è´Ÿè½½è°ƒæ•´

è¶…æ—¶è®¾ç½®ï¼š
- å¤ªçŸ­ï¼šæ­£å¸¸è¯·æ±‚ä¹Ÿå¯èƒ½è¶…æ—¶å¤±è´¥
- å¤ªé•¿ï¼šå¼‚å¸¸æƒ…å†µä¸‹ç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿
- åˆé€‚ï¼šç»“åˆä¸šåŠ¡å“åº”æ—¶é—´è¦æ±‚è®¾ç½®
```

**ğŸ”¹ è¿æ¥æ³„æ¼çš„å±å®³**ï¼š
```
è¡¨ç°ï¼šç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œè·å–è¿æ¥è¶Šæ¥è¶Šæ…¢
åŸå› ï¼šç¨‹åºè·å–è¿æ¥åå¿˜è®°å½’è¿˜ï¼Œè¿æ¥æ± é€æ¸è€—å°½
åæœï¼šæœ€ç»ˆæ‰€æœ‰ç”¨æˆ·éƒ½æ— æ³•è®¿é—®æ•°æ®åº“
è§£å†³ï¼šä½¿ç”¨try-with-resourcesï¼Œå¼€å¯æ³„æ¼æ£€æµ‹
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ–°æ‰‹å¸¸è§è¯¯åŒº**ï¼š
```
âŒ è¯¯åŒº1ï¼šä»¥ä¸ºclose()æ˜¯çœŸæ­£å…³é—­è¿æ¥
âœ… æ­£ç¡®ï¼šclose()æ˜¯æŠŠè¿æ¥å½’è¿˜ç»™è¿æ¥æ± 

âŒ è¯¯åŒº2ï¼šæ¯æ¬¡æ“ä½œéƒ½newä¸€ä¸ªDataSource  
âœ… æ­£ç¡®ï¼šDataSourceåº”è¯¥æ˜¯å…¨å±€å•ä¾‹ï¼Œå¤ç”¨è¿æ¥æ± 

âŒ è¯¯åŒº3ï¼šè¿æ¥æ•°è®¾ç½®å¾—è¶Šå¤§è¶Šå¥½
âœ… æ­£ç¡®ï¼šè¿æ¥æ•°è¦æ ¹æ®å®é™…éœ€æ±‚å’Œæ•°æ®åº“èƒ½åŠ›è®¾ç½®
```

**ğŸ“ å®é™…å¼€å‘å»ºè®®**ï¼š
1. **Spring Booté¡¹ç›®**ï¼šç›´æ¥ä½¿ç”¨é»˜è®¤é…ç½®ï¼ŒæŒ‰éœ€å¾®è°ƒ
2. **ä¼ ç»Ÿé¡¹ç›®**ï¼šå‚è€ƒç¤ºä¾‹ä»£ç ï¼Œæ³¨æ„èµ„æºç®¡ç†
3. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¼€å¯ç›‘æ§å’Œæ³„æ¼æ£€æµ‹ï¼Œå®šæœŸè°ƒä¼˜
4. **æµ‹è¯•æ–¹æ³•**ï¼šä½¿ç”¨å‹åŠ›æµ‹è¯•éªŒè¯è¿æ¥æ± é…ç½®

### 6.4 æ‰©å±•å­¦ä¹ æ–¹å‘


**ğŸŒ± è¿›é˜¶å­¦ä¹ **ï¼š
- ç›‘æ§è¿æ¥æ± çŠ¶æ€ï¼Œä½¿ç”¨JMXæˆ–Micrometer
- å­¦ä¹ å…¶ä»–è¿æ¥æ± ï¼šDruidã€C3P0çš„ç‰¹ç‚¹å¯¹æ¯”
- æ•°æ®åº“è¿æ¥ä¼˜åŒ–ï¼šç´¢å¼•ã€SQLè°ƒä¼˜ã€è¯»å†™åˆ†ç¦»

**ğŸ”— ç›¸å…³çŸ¥è¯†é“¾æ¥**ï¼š
- **å‰ç½®çŸ¥è¯†**ï¼šJDBCåŸºç¡€ã€æ•°æ®åº“è¿æ¥åŸç†
- **ç›¸å…³æ¦‚å¿µ**ï¼šæ•°æ®æºDataSourceã€äº‹åŠ¡ç®¡ç†
- **åç»­å­¦ä¹ **ï¼šSpringäº‹åŠ¡ã€MyBatisé›†æˆã€åˆ†å¸ƒå¼æ•°æ®åº“

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> HikariCPè¿æ¥æ± ï¼Œæ•°æ®åº“è®¿é—®åŠ é€Ÿå™¨  
> æœ€å¤§è¿æ¥æ§å¹¶å‘ï¼Œæœ€å°ç©ºé—²ä¿å“åº”  
> è¶…æ—¶è®¾ç½®é˜²æ­»ç­‰ï¼Œæ³„æ¼æ£€æµ‹ä¿ç¨³å®š  
> try-with-resourceså¥½ä¹ æƒ¯ï¼Œè¿æ¥å½’è¿˜ä¸å¿˜è®°