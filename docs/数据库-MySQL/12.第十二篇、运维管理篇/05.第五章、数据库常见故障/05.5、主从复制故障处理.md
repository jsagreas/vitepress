---
title: 5ã€ä¸»ä»å¤åˆ¶æ•…éšœå¤„ç†
---
## ğŸ“š ç›®å½•

1. [ä¸»ä»å¤åˆ¶åŸºç¡€æ¦‚å¿µ](#1-ä¸»ä»å¤åˆ¶åŸºç¡€æ¦‚å¿µ)
2. [Slave_IO_Runningå¼‚å¸¸å¤„ç†](#2-slave_io_runningå¼‚å¸¸å¤„ç†)
3. [Slave_SQL_Runningé”™è¯¯è§£å†³](#3-slave_sql_runningé”™è¯¯è§£å†³)
4. [å¤åˆ¶å»¶è¿Ÿè¿‡å¤§é—®é¢˜](#4-å¤åˆ¶å»¶è¿Ÿè¿‡å¤§é—®é¢˜)
5. [å¤åˆ¶ä¸­æ–­é‡è¿ç­–ç•¥](#5-å¤åˆ¶ä¸­æ–­é‡è¿ç­–ç•¥)
6. [GTIDå¤åˆ¶æ•…éšœå¤„ç†](#6-gtidå¤åˆ¶æ•…éšœå¤„ç†)
7. [äºŒè¿›åˆ¶æ—¥å¿—ä½ç‚¹é”™è¯¯](#7-äºŒè¿›åˆ¶æ—¥å¿—ä½ç‚¹é”™è¯¯)
8. [å¤åˆ¶è¿‡æ»¤è§„åˆ™é—®é¢˜](#8-å¤åˆ¶è¿‡æ»¤è§„åˆ™é—®é¢˜)
9. [æ•°æ®ä¸ä¸€è‡´ä¿®å¤](#9-æ•°æ®ä¸ä¸€è‡´ä¿®å¤)
10. [å¤åˆ¶ç”¨æˆ·æƒé™é—®é¢˜](#10-å¤åˆ¶ç”¨æˆ·æƒé™é—®é¢˜)
11. [ç½‘ç»œä¸­æ–­æ¢å¤ç­–ç•¥](#11-ç½‘ç»œä¸­æ–­æ¢å¤ç­–ç•¥)
12. [å¤åˆ¶é”™è¯¯è·³è¿‡æ–¹æ³•](#12-å¤åˆ¶é”™è¯¯è·³è¿‡æ–¹æ³•)
13. [å¤åˆ¶çŠ¶æ€ç›‘æ§](#13-å¤åˆ¶çŠ¶æ€ç›‘æ§)
14. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#14-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ä¸»ä»å¤åˆ¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯MySQLä¸»ä»å¤åˆ¶


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä¸€ä¸‹å›¾ä¹¦é¦†çš„ä¹¦ç±ç®¡ç†ï¼šä¸»å›¾ä¹¦é¦†æœ‰ä¸€å¥—å®Œæ•´çš„å›¾ä¹¦ï¼Œåˆ†é¦†éœ€è¦ä¿æŒå’Œä¸»é¦†ä¸€æ ·çš„ä¹¦ç±ã€‚å½“ä¸»é¦†æ–°è¿›ä¹¦ç±æˆ–è€…æ•´ç†ä¹¦æ¶æ—¶ï¼Œåˆ†é¦†ä¹Ÿè¦åŒæ­¥è¿™äº›å˜åŒ–ã€‚MySQLä¸»ä»å¤åˆ¶å°±æ˜¯è¿™æ ·çš„æœºåˆ¶ã€‚

**ğŸ“‹ æ ¸å¿ƒå®šä¹‰**
```
ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰ï¼š
â€¢ ä¸»åº“(Master)ï¼šæ¥æ”¶å†™æ“ä½œï¼Œäº§ç”Ÿå˜æ›´è®°å½•
â€¢ ä»åº“(Slave)ï¼šè¯»å–ä¸»åº“å˜æ›´ï¼Œé‡æ”¾è¿™äº›æ“ä½œ
â€¢ ç›®æ ‡ï¼šä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œå®ç°è¯»å†™åˆ†ç¦»
â€¢ åŸç†ï¼šé€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—(binlog)ä¼ è¾“æ•°æ®å˜æ›´
```

### 1.2 å¤åˆ¶å·¥ä½œåŸç†


**ğŸ”„ å¤åˆ¶æµç¨‹å›¾**
```
ä¸»åº“(Master)                    ä»åº“(Slave)
    |                              |
    |--[1]å†™å…¥æ“ä½œæ‰§è¡Œ------------>   |
    |--[2]è®°å½•åˆ°binlog---------->   |
    |                              |--[3]IOçº¿ç¨‹è¯·æ±‚binlog
    |<-[4]å‘é€binlogäº‹ä»¶----------|--[4]æ¥æ”¶å¹¶å†™å…¥relay log
    |                              |--[5]SQLçº¿ç¨‹è¯»å–relay log
    |                              |--[6]é‡æ”¾SQLè¯­å¥
    |                              |--[7]æ›´æ–°æœ¬åœ°æ•°æ®
```

**ğŸ’¡ æ ¸å¿ƒç»„ä»¶è¯´æ˜**
```
ä¸»åº“ç«¯ï¼š
â€¢ Binlog Dumpçº¿ç¨‹ï¼šè´Ÿè´£å‘é€binlogç»™ä»åº“
â€¢ Binary Logï¼šè®°å½•æ‰€æœ‰æ•°æ®å˜æ›´çš„æ—¥å¿—æ–‡ä»¶

ä»åº“ç«¯ï¼š
â€¢ IOçº¿ç¨‹ï¼šä»ä¸»åº“è·å–binlogï¼Œå†™å…¥relay log
â€¢ SQLçº¿ç¨‹ï¼šè¯»å–relay logï¼Œæ‰§è¡ŒSQLè¯­å¥
â€¢ Relay Logï¼šä»ä¸»åº“æ¥æ”¶åˆ°çš„æ—¥å¿—çš„æœ¬åœ°å­˜å‚¨
```

### 1.3 å¤åˆ¶çŠ¶æ€æ£€æŸ¥


**ğŸ” åŸºæœ¬çŠ¶æ€æŸ¥çœ‹**
```sql
-- ä¸»åº“çŠ¶æ€æ£€æŸ¥
SHOW MASTER STATUS;

-- ä»åº“çŠ¶æ€æ£€æŸ¥
SHOW SLAVE STATUS\G

-- æŸ¥çœ‹å¤åˆ¶çº¿ç¨‹
SHOW PROCESSLIST;
```

**ğŸ“Š å…³é”®çŠ¶æ€æŒ‡æ ‡**
| çŠ¶æ€é¡¹ | å«ä¹‰ | æ­£å¸¸å€¼ | å¼‚å¸¸å¤„ç† |
|--------|------|--------|----------|
| `Slave_IO_Running` | IOçº¿ç¨‹çŠ¶æ€ | `Yes` | æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œæƒé™ |
| `Slave_SQL_Running` | SQLçº¿ç¨‹çŠ¶æ€ | `Yes` | æ£€æŸ¥SQLé”™è¯¯å’Œå†²çª |
| `Seconds_Behind_Master` | å¤åˆ¶å»¶è¿Ÿç§’æ•° | `<10` | ä¼˜åŒ–æ€§èƒ½å’Œç½‘ç»œ |
| `Last_IO_Error` | IOé”™è¯¯ä¿¡æ¯ | ç©º | æ ¹æ®é”™è¯¯ä¿¡æ¯å¤„ç† |
| `Last_SQL_Error` | SQLé”™è¯¯ä¿¡æ¯ | ç©º | è§£å†³SQLæ‰§è¡Œé—®é¢˜ |

---

## 2. âš ï¸ Slave_IO_Runningå¼‚å¸¸å¤„ç†


### 2.1 IOçº¿ç¨‹å¼‚å¸¸çš„æœ¬è´¨


**ğŸ¤” ä»€ä¹ˆæ˜¯IOçº¿ç¨‹å¼‚å¸¸ï¼Ÿ**
> IOçº¿ç¨‹å°±åƒæ˜¯ä»åº“æ´¾å¾€ä¸»åº“çš„"ä¿¡æ¯å‘˜"ï¼Œè´Ÿè´£ä¸æ–­ä»ä¸»åº“è·å–æœ€æ–°çš„æ•°æ®å˜æ›´è®°å½•ã€‚å½“è¿™ä¸ª"ä¿¡æ¯å‘˜"å‡ºç°é—®é¢˜æ—¶ï¼Œ`Slave_IO_Running`å°±ä¼šæ˜¾ç¤ºä¸º`No`ï¼Œæ„å‘³ç€ä»åº“æ— æ³•è·å–ä¸»åº“çš„æ›´æ–°ã€‚

**ğŸ” å¸¸è§å¼‚å¸¸ç—‡çŠ¶**
```sql
-- æ£€æŸ¥IOçº¿ç¨‹çŠ¶æ€
SHOW SLAVE STATUS\G

-- å…¸å‹å¼‚å¸¸æ˜¾ç¤ºï¼š
Slave_IO_Running: No
Last_IO_Error: Got fatal error 1236 from master when reading data from binary log
```

### 2.2 ç½‘ç»œè¿æ¥é—®é¢˜


**ğŸŒ ç½‘ç»œè¿æ¥æ•…éšœè¯Šæ–­**
```bash
# æµ‹è¯•ä¸»åº“è¿æ¥æ€§
ping ä¸»åº“IP
telnet ä¸»åº“IP 3306

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
iptables -L | grep 3306
firewall-cmd --list-ports
```

**ğŸ”§ ç½‘ç»œé—®é¢˜è§£å†³æ­¥éª¤**
```sql
-- 1. é‡æ–°è®¾ç½®ä¸»åº“è¿æ¥å‚æ•°
STOP SLAVE IO_THREAD;

CHANGE MASTER TO
    MASTER_HOST='ä¸»åº“IP',
    MASTER_PORT=3306,
    MASTER_USER='replication_user',
    MASTER_PASSWORD='password',
    MASTER_CONNECT_RETRY=10,
    MASTER_RETRY_COUNT=3;

START SLAVE IO_THREAD;
```

### 2.3 æƒé™è®¤è¯é—®é¢˜


**ğŸ” å¤åˆ¶ç”¨æˆ·æƒé™æ£€æŸ¥**
```sql
-- åœ¨ä¸»åº“æ£€æŸ¥å¤åˆ¶ç”¨æˆ·æƒé™
SELECT User, Host, Repl_slave_priv FROM mysql.user 
WHERE User='replication_user';

-- åˆ›å»ºæˆ–ä¿®å¤å¤åˆ¶ç”¨æˆ·
CREATE USER 'replication_user'@'ä»åº“IP' IDENTIFIED BY 'strong_password';
GRANT REPLICATION SLAVE ON *.* TO 'replication_user'@'ä»åº“IP';
FLUSH PRIVILEGES;
```

**ğŸ’¡ æƒé™é—®é¢˜æ’æŸ¥æŠ€å·§**
```sql
-- æµ‹è¯•å¤åˆ¶ç”¨æˆ·è¿æ¥
-- åœ¨ä»åº“æ‰§è¡Œï¼š
mysql -hä¸»åº“IP -u replication_user -p

-- å¦‚æœè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥ï¼š
-- 1. ç”¨æˆ·æ˜¯å¦å­˜åœ¨
-- 2. å¯†ç æ˜¯å¦æ­£ç¡®  
-- 3. Hostæƒé™æ˜¯å¦åŒ¹é…
-- 4. æ˜¯å¦æœ‰REPLICATION SLAVEæƒé™
```

### 2.4 äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶é—®é¢˜


**ğŸ“ Binlogæ–‡ä»¶å¼‚å¸¸å¤„ç†**
```sql
-- æ£€æŸ¥ä¸»åº“binlogçŠ¶æ€
SHOW MASTER STATUS;
SHOW BINARY LOGS;

-- æ£€æŸ¥ä»åº“å½“å‰è¯»å–ä½ç½®
SHOW SLAVE STATUS\G
-- å…³æ³¨ï¼šMaster_Log_File, Read_Master_Log_Pos

-- å¦‚æœbinlogæ–‡ä»¶ä¸¢å¤±ï¼Œé‡æ–°å®šä½
STOP SLAVE;
RESET SLAVE;

-- é‡æ–°è®¾ç½®æ­£ç¡®çš„binlogä½ç½®
CHANGE MASTER TO
    MASTER_LOG_FILE='mysql-bin.000001',
    MASTER_LOG_POS=4;

START SLAVE;
```

**ğŸš¨ å¸¸è§IOé”™è¯¯ä»£ç **
```
é”™è¯¯1236: binlogæ–‡ä»¶æˆ–ä½ç½®æ— æ•ˆ
è§£å†³ï¼šé‡æ–°è·å–æ­£ç¡®çš„binlogä½ç½®

é”™è¯¯2003: æ— æ³•è¿æ¥åˆ°ä¸»åº“
è§£å†³ï¼šæ£€æŸ¥ç½‘ç»œå’Œé˜²ç«å¢™

é”™è¯¯1045: ç”¨æˆ·è®¤è¯å¤±è´¥
è§£å†³ï¼šæ£€æŸ¥å¤åˆ¶ç”¨æˆ·æƒé™å’Œå¯†ç 
```

---

## 3. ğŸ”§ Slave_SQL_Runningé”™è¯¯è§£å†³


### 3.1 SQLçº¿ç¨‹é”™è¯¯çš„æœ¬è´¨


**ğŸ­ ä»€ä¹ˆæ˜¯SQLçº¿ç¨‹é”™è¯¯ï¼Ÿ**
> SQLçº¿ç¨‹å°±åƒæ˜¯è´Ÿè´£"ç¿»è¯‘æ‰§è¡Œ"çš„å·¥ä½œäººå‘˜ã€‚IOçº¿ç¨‹å·²ç»æŠŠä¸»åº“çš„æ“ä½œè®°å½•æ‹¿å›æ¥äº†ï¼Œä½†SQLçº¿ç¨‹åœ¨æ‰§è¡Œè¿™äº›æ“ä½œæ—¶é‡åˆ°äº†é—®é¢˜ã€‚å°±åƒæ”¶åˆ°äº†ä¸€ä»½å¤–è¯­æ–‡ä»¶ï¼Œä½†ç¿»è¯‘è¿‡ç¨‹ä¸­å‘ç°å†…å®¹æœ‰å†²çªæˆ–æ— æ³•ç†è§£ã€‚

**ğŸ“Š SQLé”™è¯¯ç±»å‹åˆ†å¸ƒ**
```
å¸¸è§SQLé”™è¯¯ç±»å‹ï¼š
â”œâ”€â”€ æ•°æ®å†²çª (40%)
â”‚   â”œâ”€â”€ ä¸»é”®å†²çª
â”‚   â”œâ”€â”€ å”¯ä¸€ç´¢å¼•å†²çª  
â”‚   â””â”€â”€ å¤–é”®çº¦æŸå†²çª
â”œâ”€â”€ æ•°æ®ä¸å­˜åœ¨ (30%)
â”‚   â”œâ”€â”€ æ›´æ–°ä¸å­˜åœ¨çš„è®°å½•
â”‚   â””â”€â”€ åˆ é™¤ä¸å­˜åœ¨çš„è®°å½•
â”œâ”€â”€ è¡¨ç»“æ„å·®å¼‚ (20%)
â”‚   â”œâ”€â”€ å­—æ®µä¸å­˜åœ¨
â”‚   â””â”€â”€ è¡¨ä¸å­˜åœ¨
â””â”€â”€ æƒé™é—®é¢˜ (10%)
    â””â”€â”€ ç”¨æˆ·æƒé™ä¸è¶³
```

### 3.2 ä¸»é”®å†²çªè§£å†³


**âš¡ ä¸»é”®å†²çªçš„åŸå› **
```sql
-- å…¸å‹é”™è¯¯ä¿¡æ¯
Last_SQL_Error: Duplicate entry '123' for key 'PRIMARY'

-- åŸå› åˆ†æï¼š
-- 1. ä»åº“è¢«è¯¯å†™å…¥æ•°æ®
-- 2. å¤åˆ¶ä¸­æ–­æœŸé—´æ•°æ®ä¸åŒæ­¥
-- 3. å¤åˆ¶ç”¨æˆ·æƒé™è¿‡å¤§ï¼Œæ‰§è¡Œäº†é¢å¤–æ“ä½œ
```

**ğŸ”§ ä¸»é”®å†²çªè§£å†³æ–¹æ¡ˆ**
```sql
-- æ–¹æ¡ˆ1ï¼šè·³è¿‡å†²çªè®°å½•ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
STOP SLAVE;
SET GLOBAL sql_slave_skip_counter = 1;
START SLAVE;

-- æ–¹æ¡ˆ2ï¼šåˆ é™¤å†²çªæ•°æ®åç»§ç»­
STOP SLAVE;
-- æ‰¾åˆ°å†²çªçš„ä¸»é”®å€¼ï¼Œæ‰‹åŠ¨åˆ é™¤
DELETE FROM table_name WHERE id = 123;
START SLAVE;

-- æ–¹æ¡ˆ3ï¼šä½¿ç”¨slave_skip_errorsï¼ˆé…ç½®æ–‡ä»¶ï¼‰
-- my.cnfä¸­æ·»åŠ ï¼š
-- slave_skip_errors = 1062  # è·³è¿‡ä¸»é”®å†²çªé”™è¯¯
```

### 3.3 æ•°æ®ä¸å­˜åœ¨é”™è¯¯


**ğŸ” æ•°æ®ä¸å­˜åœ¨é—®é¢˜åˆ†æ**
```sql
-- å…¸å‹é”™è¯¯
Last_SQL_Error: Can't find record in 'table_name'

-- æ£€æŸ¥å…·ä½“SQLè¯­å¥
SHOW SLAVE STATUS\G
-- æŸ¥çœ‹ï¼šLast_SQL_Error_Timestamp, Last_SQL_Error
```

**ğŸ’Š æ•°æ®ä¸å­˜åœ¨è§£å†³æ­¥éª¤**
```sql
-- 1. æ£€æŸ¥ä¸»ä»æ•°æ®å·®å¼‚
-- åœ¨ä¸»åº“æ‰§è¡Œï¼š
SELECT COUNT(*) FROM table_name WHERE condition;

-- åœ¨ä»åº“æ‰§è¡Œï¼š
SELECT COUNT(*) FROM table_name WHERE condition;

-- 2. å¦‚æœç¡®è®¤æ•°æ®åº”è¯¥å­˜åœ¨ï¼Œä»ä¸»åº“åŒæ­¥
-- å¯¼å‡ºä¸»åº“æ•°æ®
mysqldump -hä¸»åº“IP -uç”¨æˆ· -pæ•°æ®åº“ table_name --where="condition" > data.sql

-- å¯¼å…¥åˆ°ä»åº“
mysql -uç”¨æˆ· -pæ•°æ®åº“ < data.sql

-- 3. é‡å¯å¤åˆ¶
START SLAVE;
```

### 3.4 è¡¨ç»“æ„å·®å¼‚å¤„ç†


**ğŸ—ï¸ è¡¨ç»“æ„ä¸ä¸€è‡´é—®é¢˜**
```sql
-- å…¸å‹é”™è¯¯
Last_SQL_Error: Table 'database.table_name' doesn't exist

-- æ£€æŸ¥è¡¨ç»“æ„å·®å¼‚
-- ä¸»åº“ï¼š
SHOW CREATE TABLE table_name\G

-- ä»åº“ï¼š
SHOW CREATE TABLE table_name\G
```

**ğŸ”¨ ç»“æ„å·®å¼‚ä¿®å¤æ–¹æ³•**
```sql
-- 1. åŒæ­¥è¡¨ç»“æ„ï¼ˆå¦‚æœè¡¨ä¸å­˜åœ¨ï¼‰
-- ä»ä¸»åº“å¯¼å‡ºè¡¨ç»“æ„
mysqldump -hä¸»åº“IP -uç”¨æˆ· -p -d æ•°æ®åº“ table_name > table_structure.sql

-- åœ¨ä»åº“åˆ›å»ºè¡¨
mysql -uç”¨æˆ· -pæ•°æ®åº“ < table_structure.sql

-- 2. ä¿®å¤å­—æ®µå·®å¼‚
-- æ ¹æ®ä¸»åº“ç»“æ„ä¿®æ”¹ä»åº“
ALTER TABLE table_name ADD COLUMN new_column VARCHAR(50);
ALTER TABLE table_name MODIFY COLUMN existing_column TEXT;
```

---

## 4. â±ï¸ å¤åˆ¶å»¶è¿Ÿè¿‡å¤§é—®é¢˜


### 4.1 å¤åˆ¶å»¶è¿Ÿçš„æ ¹æœ¬åŸå› 


**ğŸŒ ä»€ä¹ˆæ˜¯å¤åˆ¶å»¶è¿Ÿï¼Ÿ**
> æƒ³è±¡ä¸€ä¸‹æ–°é—»ä¼ æ’­ï¼šè®°è€…åœ¨ç°åœºæŠ¥é“(ä¸»åº“å†™å…¥)ï¼Œä½†è§‚ä¼—çœ‹åˆ°æ–°é—»(ä»åº“è¯»å–)éœ€è¦æ—¶é—´ã€‚å¦‚æœä¼ è¾“æˆ–å¤„ç†ç¯èŠ‚å‡ºç°ç“¶é¢ˆï¼Œè§‚ä¼—å°±ä¼šçœ‹åˆ°"è¿‡æ—¶"çš„æ–°é—»ã€‚å¤åˆ¶å»¶è¿Ÿå°±æ˜¯ä¸»åº“æ‰§è¡Œæ“ä½œå’Œä»åº“å®ŒæˆåŒæ­¥ä¹‹é—´çš„æ—¶é—´å·®ã€‚

**ğŸ“Š å»¶è¿ŸåŸå› åˆ†æå›¾**
```
å¤åˆ¶å»¶è¿ŸåŸå› å±‚æ¬¡ï¼š
â”œâ”€â”€ ç½‘ç»œå±‚é¢ (30%)
â”‚   â”œâ”€â”€ å¸¦å®½ä¸è¶³
â”‚   â”œâ”€â”€ ç½‘ç»œå»¶è¿Ÿé«˜
â”‚   â””â”€â”€ ä¸¢åŒ…é‡ä¼ 
â”œâ”€â”€ ä¸»åº“æ€§èƒ½ (25%)
â”‚   â”œâ”€â”€ å†™å…¥å‹åŠ›å¤§
â”‚   â”œâ”€â”€ binlogåˆ·æ–°æ…¢
â”‚   â””â”€â”€ ç£ç›˜IOç“¶é¢ˆ
â”œâ”€â”€ ä»åº“æ€§èƒ½ (35%)
â”‚   â”œâ”€â”€ SQLçº¿ç¨‹å¤„ç†æ…¢
â”‚   â”œâ”€â”€ ç£ç›˜æ€§èƒ½å·®
â”‚   â””â”€â”€ å•çº¿ç¨‹å›æ”¾é™åˆ¶
â””â”€â”€ é…ç½®é—®é¢˜ (10%)
    â”œâ”€â”€ å‚æ•°è®¾ç½®ä¸å½“
    â””â”€â”€ å¤åˆ¶æ ¼å¼é€‰æ‹©
```

### 4.2 å»¶è¿Ÿç›‘æ§å’Œè¯Šæ–­


**ğŸ” å»¶è¿Ÿæ£€æŸ¥æ–¹æ³•**
```sql
-- åŸºæœ¬å»¶è¿Ÿæ£€æŸ¥
SHOW SLAVE STATUS\G
-- é‡ç‚¹å…³æ³¨ï¼šSeconds_Behind_Master

-- è¯¦ç»†å»¶è¿Ÿåˆ†æ
SELECT 
    ROUND(
        (UNIX_TIMESTAMP(NOW()) - UNIX_TIMESTAMP(Last_IO_Error_Timestamp)), 2
    ) AS io_delay_seconds,
    ROUND(
        (UNIX_TIMESTAMP(NOW()) - UNIX_TIMESTAMP(Last_SQL_Error_Timestamp)), 2  
    ) AS sql_delay_seconds;
```

**ğŸ“ˆ å»¶è¿Ÿç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# å»¶è¿Ÿç›‘æ§è„šæœ¬
while true; do
    delay=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master" | awk '{print $2}')
    
    if [ "$delay" = "NULL" ]; then
        echo "$(date): å¤åˆ¶åœæ­¢æˆ–å¼‚å¸¸"
    elif [ "$delay" -gt 30 ]; then
        echo "$(date): å»¶è¿Ÿè¿‡å¤§: ${delay}ç§’"
        # å‘é€å‘Šè­¦
    else
        echo "$(date): å»¶è¿Ÿæ­£å¸¸: ${delay}ç§’"
    fi
    
    sleep 10
done
```

### 4.3 ç½‘ç»œå±‚å»¶è¿Ÿä¼˜åŒ–


**ğŸŒ ç½‘ç»œä¼˜åŒ–ç­–ç•¥**
```bash
# 1. ç½‘ç»œå»¶è¿Ÿæµ‹è¯•
ping -c 10 ä¸»åº“IP

# 2. å¸¦å®½æµ‹è¯•
iperf3 -c ä¸»åº“IP -t 60

# 3. MySQLç½‘ç»œå‚æ•°ä¼˜åŒ–
# åœ¨my.cnfä¸­è®¾ç½®ï¼š
[mysql]
connect_timeout = 10
wait_timeout = 3600
interactive_timeout = 3600

[mysqld]
max_connections = 1000
max_connect_errors = 999999
```

### 4.4 å¹¶è¡Œå¤åˆ¶ä¼˜åŒ–


**âš¡ å¹¶è¡Œå¤åˆ¶é…ç½®**
```sql
-- MySQL 5.7+ å¹¶è¡Œå¤åˆ¶è®¾ç½®
STOP SLAVE;

-- è®¾ç½®å¹¶è¡Œå¤åˆ¶ç±»å‹
SET GLOBAL slave_parallel_type = 'LOGICAL_CLOCK';

-- è®¾ç½®å¹¶è¡Œå·¥ä½œçº¿ç¨‹æ•°ï¼ˆå»ºè®®ï¼šCPUæ ¸å¿ƒæ•°çš„1-2å€ï¼‰
SET GLOBAL slave_parallel_workers = 8;

-- å¯ç”¨åŸºäºç»„æäº¤çš„å¹¶è¡Œå¤åˆ¶
SET GLOBAL slave_preserve_commit_order = 1;

START SLAVE;
```

**ğŸ”§ å¹¶è¡Œå¤åˆ¶ç›‘æ§**
```sql
-- ç›‘æ§å¹¶è¡Œå¤åˆ¶æ•ˆæœ
SELECT 
    WORKER_ID,
    SERVICE_STATE,
    LAST_ERROR_MESSAGE,
    LAST_ERROR_TIMESTAMP
FROM performance_schema.replication_applier_status_by_worker;

-- æŸ¥çœ‹å¤åˆ¶å»¶è¿Ÿæ”¹å–„æƒ…å†µ
SHOW SLAVE STATUS\G
```

### 4.5 æ€§èƒ½è°ƒä¼˜ç­–ç•¥


**ğŸ’¾ ä»åº“æ€§èƒ½ä¼˜åŒ–**
```sql
-- 1. è°ƒæ•´InnoDBå‚æ•°
SET GLOBAL innodb_flush_log_at_trx_commit = 2;  -- é™ä½ç£ç›˜åŒæ­¥é¢‘ç‡
SET GLOBAL sync_binlog = 0;                     -- å…³é—­binlogåŒæ­¥ï¼ˆä»åº“ï¼‰
SET GLOBAL innodb_buffer_pool_size = '70%å†…å­˜'; -- å¢å¤§ç¼“å†²æ± 

-- 2. ä¼˜åŒ–å¤åˆ¶ç›¸å…³å‚æ•°  
SET GLOBAL slave_net_timeout = 60;              -- ç½‘ç»œè¶…æ—¶æ—¶é—´
SET GLOBAL slave_compressed_protocol = 1;       -- å¯ç”¨å‹ç¼©ä¼ è¾“
```

**ğŸ“ é…ç½®æ–‡ä»¶ä¼˜åŒ–**
```ini
# my.cnf ä»åº“ä¼˜åŒ–é…ç½®
[mysqld]
# åŸºç¡€æ€§èƒ½å‚æ•°
innodb_buffer_pool_size = 8G
innodb_log_file_size = 1G
innodb_log_buffer_size = 64M

# å¤åˆ¶ä¼˜åŒ–å‚æ•°
slave_parallel_workers = 8
slave_parallel_type = LOGICAL_CLOCK
slave_preserve_commit_order = 1
slave_compressed_protocol = 1

# å‡å°‘ç£ç›˜åŒæ­¥
innodb_flush_log_at_trx_commit = 2
sync_binlog = 0
sync_relay_log = 0
```

---

## 5. ğŸ”„ å¤åˆ¶ä¸­æ–­é‡è¿ç­–ç•¥


### 5.1 å¤åˆ¶ä¸­æ–­çš„å¸¸è§åœºæ™¯


**ğŸš¨ ä¸­æ–­å‘ç”Ÿçš„å…¸å‹æƒ…å†µ**
> å¤åˆ¶ä¸­æ–­å°±åƒæ‰“ç”µè¯æ—¶çªç„¶æ–­çº¿ã€‚å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ã€æœåŠ¡å™¨é‡å¯ã€æˆ–è€…å…¶ä»–æ„å¤–æƒ…å†µã€‚å…³é”®æ˜¯è¦æœ‰è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼Œå°±åƒæ‰‹æœºä¼šè‡ªåŠ¨å°è¯•é‡æ‹¨ä¸€æ ·ã€‚

**ğŸ“‹ ä¸­æ–­åŸå› åˆ†ç±»**
```
ä¸­æ–­åŸå› ç»Ÿè®¡ï¼š
â”œâ”€â”€ ç½‘ç»œæ•…éšœ (45%)
â”‚   â”œâ”€â”€ ç½‘ç»œé—ªæ–­
â”‚   â”œâ”€â”€ è·¯ç”±é—®é¢˜
â”‚   â””â”€â”€ é˜²ç«å¢™é˜»æ–­
â”œâ”€â”€ æœåŠ¡å™¨é—®é¢˜ (30%)
â”‚   â”œâ”€â”€ MySQLæœåŠ¡é‡å¯
â”‚   â”œâ”€â”€ æœåŠ¡å™¨é‡å¯
â”‚   â””â”€â”€ å†…å­˜ä¸è¶³
â”œâ”€â”€ é…ç½®é—®é¢˜ (15%)
â”‚   â”œâ”€â”€ è¶…æ—¶è®¾ç½®è¿‡çŸ­
â”‚   â”œâ”€â”€ è¿æ¥æ•°é™åˆ¶
â”‚   â””â”€â”€ æƒé™è¿‡æœŸ
â””â”€â”€ å…¶ä»–åŸå›  (10%)
    â”œâ”€â”€ ç£ç›˜ç©ºé—´æ»¡
    â””â”€â”€ äººä¸ºæ“ä½œé”™è¯¯
```

### 5.2 è‡ªåŠ¨é‡è¿é…ç½®


**ğŸ”„ é‡è¿å‚æ•°è®¾ç½®**
```sql
-- é…ç½®è‡ªåŠ¨é‡è¿å‚æ•°
STOP SLAVE;

CHANGE MASTER TO
    MASTER_CONNECT_RETRY = 10,    -- é‡è¿é—´éš”ï¼ˆç§’ï¼‰
    MASTER_RETRY_COUNT = 86400,   -- é‡è¿æ¬¡æ•°ï¼ˆ0è¡¨ç¤ºæ— é™é‡è¯•ï¼‰
    MASTER_HEARTBEAT_PERIOD = 30; -- å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰

START SLAVE;
```

**âš™ï¸ é…ç½®æ–‡ä»¶é‡è¿è®¾ç½®**
```ini
# my.cnf é‡è¿ç›¸å…³é…ç½®
[mysqld]
# åŸºç¡€é‡è¿å‚æ•°
slave_net_timeout = 120           # ç½‘ç»œè¶…æ—¶æ—¶é—´
master_connect_retry = 10         # é‡è¿é—´éš”
master_retry_count = 86400        # é‡è¿æ¬¡æ•°

# å¿ƒè·³æœºåˆ¶
master_heartbeat_period = 30      # å¿ƒè·³é—´éš”

# è¿æ¥ä¿æŒ
wait_timeout = 3600              # è¿æ¥ç­‰å¾…è¶…æ—¶
interactive_timeout = 3600        # äº¤äº’è¶…æ—¶
```

### 5.3 ä¸­æ–­æ£€æµ‹æœºåˆ¶


**ğŸ” ä¸­æ–­æ£€æµ‹è„šæœ¬**
```bash
#!/bin/bash
# å¤åˆ¶çŠ¶æ€æ£€æµ‹å’Œè‡ªåŠ¨æ¢å¤è„šæœ¬

LOG_FILE="/var/log/mysql_replication_monitor.log"

check_replication() {
    io_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_IO_Running:" | awk '{print $2}')
    sql_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_SQL_Running:" | awk '{print $2}')
    
    if [[ "$io_running" != "Yes" || "$sql_running" != "Yes" ]]; then
        echo "$(date): æ£€æµ‹åˆ°å¤åˆ¶ä¸­æ–­ - IO: $io_running, SQL: $sql_running" >> $LOG_FILE
        return 1
    else
        echo "$(date): å¤åˆ¶çŠ¶æ€æ­£å¸¸" >> $LOG_FILE
        return 0
    fi
}

restart_replication() {
    echo "$(date): å°è¯•é‡å¯å¤åˆ¶..." >> $LOG_FILE
    
    mysql -e "STOP SLAVE;"
    sleep 5
    mysql -e "START SLAVE;"
    
    sleep 10
    
    if check_replication; then
        echo "$(date): å¤åˆ¶é‡å¯æˆåŠŸ" >> $LOG_FILE
    else
        echo "$(date): å¤åˆ¶é‡å¯å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥" >> $LOG_FILE
        # å‘é€å‘Šè­¦é€šçŸ¥
        echo "MySQLå¤åˆ¶é‡å¯å¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥" | mail -s "MySQLå¤åˆ¶å‘Šè­¦" admin@company.com
    fi
}

# ä¸»ç›‘æ§å¾ªç¯
while true; do
    if ! check_replication; then
        restart_replication
    fi
    sleep 60
done
```

### 5.4 ä¼˜é›…é‡è¿ç­–ç•¥


**ğŸ¯ é‡è¿æœ€ä½³å®è·µ**
```sql
-- 1. æ£€æŸ¥å½“å‰çŠ¶æ€
SHOW SLAVE STATUS\G

-- 2. åœæ­¢å¤åˆ¶ï¼ˆä¿å­˜ä½ç½®ä¿¡æ¯ï¼‰
STOP SLAVE;

-- 3. æ£€æŸ¥å’Œä¿®å¤è¿æ¥é—®é¢˜
-- æµ‹è¯•ç½‘ç»œè¿æ¥
-- éªŒè¯ç”¨æˆ·æƒé™
-- æ£€æŸ¥ä¸»åº“çŠ¶æ€

-- 4. é‡æ–°å¯åŠ¨å¤åˆ¶
START SLAVE;

-- 5. éªŒè¯æ¢å¤æ•ˆæœ
SHOW SLAVE STATUS\G
```

**âš ï¸ é‡è¿æ³¨æ„äº‹é¡¹**
```
é‡è¿æ£€æŸ¥æ¸…å•ï¼š
â–¡ ç½‘ç»œè¿æ¥æ˜¯å¦æ¢å¤
â–¡ ä¸»åº“æœåŠ¡æ˜¯å¦æ­£å¸¸
â–¡ å¤åˆ¶ç”¨æˆ·æƒé™æ˜¯å¦æœ‰æ•ˆ
â–¡ binlogæ–‡ä»¶æ˜¯å¦å­˜åœ¨
â–¡ ä»åº“ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
â–¡ å¤åˆ¶ä½ç½®æ˜¯å¦æ­£ç¡®
```

---

## 6. ğŸ†” GTIDå¤åˆ¶æ•…éšœå¤„ç†


### 6.1 GTIDå¤åˆ¶åŸºç¡€æ¦‚å¿µ


**ğŸ·ï¸ ä»€ä¹ˆæ˜¯GTIDï¼Ÿ**
> GTIDå°±åƒæ˜¯æ¯ä¸ªæ•°æ®å˜æ›´æ“ä½œçš„"èº«ä»½è¯å·ç "ã€‚ä¼ ç»Ÿå¤åˆ¶éœ€è¦è®°ä½"åœ¨å“ªä¸ªæ–‡ä»¶çš„ç¬¬å‡ è¡Œ"ï¼Œè€ŒGTIDå¤åˆ¶åªéœ€è¦è®°ä½"æ‰§è¡Œåˆ°å“ªä¸ªèº«ä»½è¯å·ç "ã€‚è¿™æ ·å³ä½¿æ–‡ä»¶ä¸¢å¤±æˆ–ä½ç½®æ··ä¹±ï¼Œä¹Ÿèƒ½å‡†ç¡®çŸ¥é“æ‰§è¡Œè¿›åº¦ã€‚

**ğŸ“‹ GTIDç»„æˆç»“æ„**
```
GTIDæ ¼å¼ï¼šserver_uuid:transaction_id
ç¤ºä¾‹ï¼š3E11FA47-71CA-11E1-9E33-C80AA9429562:23

ç»„æˆéƒ¨åˆ†ï¼š
â”œâ”€â”€ server_uuid (36ä½)
â”‚   â””â”€â”€ æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ç¬¦
â””â”€â”€ transaction_id (æ•°å­—)
    â””â”€â”€ äº‹åŠ¡åºå·ï¼ˆé€’å¢ï¼‰

GTIDé›†åˆç¤ºä¾‹ï¼š
3E11FA47-71CA-11E1-9E33-C80AA9429562:1-5:10-15
è¡¨ç¤ºï¼šæ‰§è¡Œäº†ç¼–å·1-5å’Œ10-15çš„äº‹åŠ¡
```

### 6.2 GTIDå¤åˆ¶é…ç½®


**âš™ï¸ å¯ç”¨GTIDå¤åˆ¶**
```sql
-- 1. ä¿®æ”¹é…ç½®æ–‡ä»¶ my.cnf
[mysqld]
# å¯ç”¨GTID
gtid_mode = ON
enforce_gtid_consistency = ON
log_bin = mysql-bin
log_slave_updates = ON
server_id = 1  # ä¸»åº“
# server_id = 2  # ä»åº“ï¼Œå¿…é¡»ä¸åŒ

-- 2. é‡å¯MySQLæœåŠ¡åæ£€æŸ¥
SHOW GLOBAL VARIABLES LIKE '%gtid%';
```

**ğŸ”§ GTIDå¤åˆ¶å»ºç«‹**
```sql
-- åœ¨ä»åº“é…ç½®GTIDå¤åˆ¶
STOP SLAVE;

CHANGE MASTER TO
    MASTER_HOST = 'ä¸»åº“IP',
    MASTER_USER = 'replication_user',
    MASTER_PASSWORD = 'password',
    MASTER_AUTO_POSITION = 1;  -- å¯ç”¨GTIDè‡ªåŠ¨å®šä½

START SLAVE;
```

### 6.3 GTIDå¤åˆ¶æ•…éšœè¯Šæ–­


**ğŸ” GTIDçŠ¶æ€æ£€æŸ¥**
```sql
-- æŸ¥çœ‹GTIDæ‰§è¡ŒçŠ¶æ€
SHOW SLAVE STATUS\G
-- å…³æ³¨ï¼š
-- Auto_Position: æ˜¯å¦å¯ç”¨è‡ªåŠ¨å®šä½
-- Retrieved_Gtid_Set: å·²æ¥æ”¶çš„GTIDé›†åˆ
-- Executed_Gtid_Set: å·²æ‰§è¡Œçš„GTIDé›†åˆ

-- æŸ¥çœ‹å½“å‰GTIDçŠ¶æ€
SHOW GLOBAL VARIABLES LIKE '%gtid%';
SELECT $$GLOBAL.gtid_executed;
SELECT $$GLOBAL.gtid_purged;
```

**ğŸ“Š GTIDçŠ¶æ€æŒ‡æ ‡è§£æ**
| çŠ¶æ€å˜é‡ | å«ä¹‰ | æ­£å¸¸æƒ…å†µ | å¼‚å¸¸å¤„ç† |
|----------|------|----------|----------|
| `gtid_executed` | å·²æ‰§è¡Œçš„GTIDé›†åˆ | æŒç»­å¢é•¿ | æ£€æŸ¥æ‰§è¡Œè¿›åº¦ |
| `gtid_purged` | å·²æ¸…ç†çš„GTIDé›†åˆ | éšbinlogæ¸…ç†å¢é•¿ | æ³¨æ„ä¸è¦æ¸…ç†è¿‡å¤š |
| `Retrieved_Gtid_Set` | ä»ä¸»åº“è·å–çš„GTID | ä¸ä¸»åº“åŒæ­¥ | æ£€æŸ¥ç½‘ç»œè¿æ¥ |
| `Executed_Gtid_Set` | ä»åº“æ‰§è¡Œçš„GTID | è¿½èµ¶Retrieved | æ£€æŸ¥SQLçº¿ç¨‹ |

### 6.4 GTIDå¤åˆ¶å¸¸è§é—®é¢˜


**âš ï¸ GTIDå†²çªé—®é¢˜**
```sql
-- é”™è¯¯ç¤ºä¾‹ï¼š
Last_SQL_Error: When $$SESSION.GTID_NEXT is set to a GTID, 
you must explicitly set it to a different value after a COMMIT or ROLLBACK

-- è§£å†³æ–¹æ³•ï¼š
STOP SLAVE;
SET GTID_NEXT='AUTOMATIC';
START SLAVE;
```

**ğŸ”§ GTIDè·³è¿‡é”™è¯¯äº‹åŠ¡**
```sql
-- æŸ¥çœ‹å…·ä½“é”™è¯¯çš„GTID
SHOW SLAVE STATUS\G
-- æ‰¾åˆ°ï¼šLast_SQL_Errorä¸­çš„GTID

-- è·³è¿‡ç‰¹å®šGTIDäº‹åŠ¡
STOP SLAVE;
SET GTID_NEXT='3E11FA47-71CA-11E1-9E33-C80AA9429562:23';
BEGIN; COMMIT;
SET GTID_NEXT='AUTOMATIC';
START SLAVE;
```

### 6.5 GTIDå¤åˆ¶æ¢å¤ç­–ç•¥


**ğŸ› ï¸ GTIDå¤åˆ¶é‡å»º**
```sql
-- 1. åœæ­¢å¤åˆ¶å¹¶é‡ç½®
STOP SLAVE;
RESET SLAVE ALL;

-- 2. è·å–ä¸»åº“GTIDçŠ¶æ€
-- åœ¨ä¸»åº“æ‰§è¡Œï¼š
SHOW MASTER STATUS;
SELECT $$GLOBAL.gtid_executed;

-- 3. é‡æ–°é…ç½®ä»åº“
CHANGE MASTER TO
    MASTER_HOST = 'ä¸»åº“IP',
    MASTER_USER = 'replication_user', 
    MASTER_PASSWORD = 'password',
    MASTER_AUTO_POSITION = 1;

-- 4. å¦‚æœéœ€è¦è·³è¿‡éƒ¨åˆ†GTID
SET $$GLOBAL.gtid_purged = '3E11FA47-71CA-11E1-9E33-C80AA9429562:1-100';

START SLAVE;
```

**ğŸ’¡ GTIDæœ€ä½³å®è·µ**
```
GTIDä½¿ç”¨å»ºè®®ï¼š
âœ… æ–°å»ºå¤åˆ¶ä¼˜å…ˆä½¿ç”¨GTID
âœ… å®šæœŸå¤‡ä»½gtid_executedçŠ¶æ€
âœ… ç›‘æ§GTIDé›†åˆè¿ç»­æ€§
âœ… é¿å…åœ¨ä»åº“æ‰‹åŠ¨æ‰§è¡Œäº‹åŠ¡
âš ï¸ å‡çº§åˆ°GTIDéœ€è¦åœæœºåˆ‡æ¢
âš ï¸ æ··åˆä½¿ç”¨ä¼ ç»Ÿå¤åˆ¶å’ŒGTIDå¤åˆ¶
```

---

## 7. ğŸ“ äºŒè¿›åˆ¶æ—¥å¿—ä½ç‚¹é”™è¯¯


### 7.1 Binlogä½ç‚¹çš„å·¥ä½œåŸç†


**ğŸ“š ä½ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ**
> æƒ³è±¡è¯»ä¹¦æ—¶ä½¿ç”¨ä¹¦ç­¾ï¼šä¹¦ç­¾å‘Šè¯‰ä½ è¯»åˆ°äº†ç¬¬å‡ é¡µçš„ç¬¬å‡ è¡Œã€‚Binlogä½ç‚¹å°±æ˜¯MySQLå¤åˆ¶ä¸­çš„"ä¹¦ç­¾"ï¼Œå‘Šè¯‰ä»åº“è¯»å–åˆ°äº†ä¸»åº“äºŒè¿›åˆ¶æ—¥å¿—çš„ç¬¬å‡ ä¸ªæ–‡ä»¶çš„ç¬¬å‡ ä¸ªä½ç½®ã€‚

**ğŸ“Š ä½ç‚¹ä¿¡æ¯ç»„æˆ**
```
ä½ç‚¹ä¿¡æ¯åŒ…å«ï¼š
â”œâ”€â”€ æ–‡ä»¶å (Master_Log_File)
â”‚   â””â”€â”€ å¦‚ï¼šmysql-bin.000001
â””â”€â”€ ä½ç½® (Master_Log_Pos)
    â””â”€â”€ å¦‚ï¼š154ï¼ˆå­—èŠ‚åç§»é‡ï¼‰

ä½ç‚¹å˜åŒ–è¿‡ç¨‹ï¼š
ä¸»åº“å†™å…¥æ“ä½œ â†’ binlogè®°å½•äº‹ä»¶ â†’ ä½ç‚¹å‘åç§»åŠ¨ â†’ ä»åº“è¯»å–å¹¶è·Ÿè¿›
```

### 7.2 ä½ç‚¹é”™è¯¯çš„å¸¸è§ç—‡çŠ¶


**ğŸš¨ å…¸å‹ä½ç‚¹é”™è¯¯**
```sql
-- é”™è¯¯ç¤ºä¾‹1ï¼šæ–‡ä»¶ä¸å­˜åœ¨
Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: 
'Binary log file 'mysql-bin.000005' is not found'

-- é”™è¯¯ç¤ºä¾‹2ï¼šä½ç½®æ— æ•ˆ  
Last_IO_Error: Got fatal error 1236 from master when reading data from binary log:
'Binlog has bad magic number'

-- æ£€æŸ¥å½“å‰ä½ç‚¹çŠ¶æ€
SHOW SLAVE STATUS\G
-- é‡ç‚¹å…³æ³¨ï¼š
-- Master_Log_File: å½“å‰è¯»å–çš„binlogæ–‡ä»¶
-- Read_Master_Log_Pos: å½“å‰è¯»å–ä½ç½®
-- Exec_Master_Log_Pos: å½“å‰æ‰§è¡Œä½ç½®
```

### 7.3 ä½ç‚¹é”™è¯¯è¯Šæ–­


**ğŸ” ä½ç‚¹çŠ¶æ€æ£€æŸ¥æ–¹æ³•**
```sql
-- 1. æ£€æŸ¥ä¸»åº“binlogçŠ¶æ€
-- åœ¨ä¸»åº“æ‰§è¡Œï¼š
SHOW MASTER STATUS;
SHOW BINARY LOGS;

-- 2. æ£€æŸ¥ä»åº“ä½ç‚¹çŠ¶æ€  
-- åœ¨ä»åº“æ‰§è¡Œï¼š
SHOW SLAVE STATUS\G

-- 3. å¯¹æ¯”åˆ†æ
-- ä¸»åº“å½“å‰ä½ç‚¹ï¼šFile + Position
-- ä»åº“è¯»å–ä½ç‚¹ï¼šMaster_Log_File + Read_Master_Log_Pos
-- ä»åº“æ‰§è¡Œä½ç‚¹ï¼šMaster_Log_File + Exec_Master_Log_Pos
```

**ğŸ“‹ ä½ç‚¹è¯Šæ–­æ£€æŸ¥æ¸…å•**
```
ä½ç‚¹é—®é¢˜æ’æŸ¥æ­¥éª¤ï¼š
â–¡ ä¸»åº“binlogæ–‡ä»¶æ˜¯å¦å­˜åœ¨
â–¡ ä»åº“æŒ‡å‘çš„æ–‡ä»¶åæ˜¯å¦æ­£ç¡®
â–¡ ä½ç½®åç§»é‡æ˜¯å¦åœ¨æ–‡ä»¶èŒƒå›´å†…
â–¡ binlogæ–‡ä»¶æ˜¯å¦æŸå
â–¡ ç½‘ç»œä¼ è¾“æ˜¯å¦å‡ºç°é—®é¢˜
â–¡ ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
```

### 7.4 ä½ç‚¹é”™è¯¯ä¿®å¤æ–¹æ³•


**ğŸ”§ è‡ªåŠ¨ä½ç‚¹ä¿®å¤**
```sql
-- æ–¹æ³•1ï¼šé‡æ–°è·å–æœ€æ–°ä½ç‚¹
-- åœ¨ä¸»åº“è·å–å½“å‰ä½ç‚¹
FLUSH LOGS;  -- ç”Ÿæˆæ–°çš„binlogæ–‡ä»¶
SHOW MASTER STATUS;

-- åœ¨ä»åº“é‡æ–°è®¾ç½®ä½ç‚¹
STOP SLAVE;
CHANGE MASTER TO
    MASTER_LOG_FILE = 'mysql-bin.000006',  -- æ–°çš„æ–‡ä»¶å
    MASTER_LOG_POS = 4;                    -- æ–°æ–‡ä»¶èµ·å§‹ä½ç½®

START SLAVE;
```

**ğŸ› ï¸ ç²¾ç¡®ä½ç‚¹æ¢å¤**
```sql
-- æ–¹æ³•2ï¼šæŸ¥æ‰¾å¯ç”¨çš„æœ€è¿‘ä½ç‚¹
-- åœ¨ä¸»åº“æ£€æŸ¥binlogäº‹ä»¶
SHOW BINLOG EVENTS IN 'mysql-bin.000005' LIMIT 10;

-- æ‰¾åˆ°åˆé€‚çš„ä½ç‚¹ï¼ˆé€šå¸¸æ˜¯äº‹åŠ¡å¼€å§‹ä½ç½®ï¼‰
-- åœ¨ä»åº“è®¾ç½®ç²¾ç¡®ä½ç‚¹
STOP SLAVE;
CHANGE MASTER TO
    MASTER_LOG_FILE = 'mysql-bin.000005',
    MASTER_LOG_POS = 1024;  -- æ‰¾åˆ°çš„å®‰å…¨ä½ç‚¹

START SLAVE;
```

### 7.5 ä½ç‚¹é—®é¢˜é¢„é˜²


**âš¡ ä½ç‚¹å¤‡ä»½ç­–ç•¥**
```bash
#!/bin/bash
# å®šæœŸå¤‡ä»½å¤åˆ¶ä½ç‚¹ä¿¡æ¯

BACKUP_DIR="/var/backup/mysql_replication"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½ä»åº“çŠ¶æ€
mysql -e "SHOW SLAVE STATUS\G" > $BACKUP_DIR/slave_status_$DATE.txt

# å¤‡ä»½ä¸»åº“çŠ¶æ€  
mysql -hä¸»åº“IP -uç›‘æ§ç”¨æˆ· -på¯†ç  -e "SHOW MASTER STATUS;" > $BACKUP_DIR/master_status_$DATE.txt

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "*.txt" -mtime +7 -delete

echo "$(date): ä½ç‚¹ä¿¡æ¯å¤‡ä»½å®Œæˆ"
```

**ğŸ“Š ä½ç‚¹ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# ä½ç‚¹å¥åº·æ£€æŸ¥è„šæœ¬

check_binlog_health() {
    # è·å–ä»åº“ä½ç‚¹ä¿¡æ¯
    slave_file=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Master_Log_File:" | awk '{print $2}')
    slave_pos=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Read_Master_Log_Pos:" | awk '{print $2}')
    
    # æ£€æŸ¥ä¸»åº“å¯¹åº”æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if mysql -hä¸»åº“IP -uç”¨æˆ· -på¯†ç  -e "SHOW BINARY LOGS;" | grep -q "$slave_file"; then
        echo "ä½ç‚¹æ–‡ä»¶æ£€æŸ¥æ­£å¸¸: $slave_file"
        return 0
    else
        echo "ä½ç‚¹æ–‡ä»¶æ£€æŸ¥å¼‚å¸¸: $slave_file ä¸å­˜åœ¨äºä¸»åº“"
        return 1
    fi
}

# æ‰§è¡Œæ£€æŸ¥
if check_binlog_health; then
    echo "$(date): Binlogä½ç‚¹å¥åº·æ£€æŸ¥é€šè¿‡"
else
    echo "$(date): Binlogä½ç‚¹å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œéœ€è¦ä¿®å¤"
    # å‘é€å‘Šè­¦
fi
```

---

## 8. ğŸ¯ å¤åˆ¶è¿‡æ»¤è§„åˆ™é—®é¢˜


### 8.1 å¤åˆ¶è¿‡æ»¤çš„åŸºæœ¬æ¦‚å¿µ


**ğŸª ä»€ä¹ˆæ˜¯å¤åˆ¶è¿‡æ»¤ï¼Ÿ**
> å¤åˆ¶è¿‡æ»¤å°±åƒæ˜¯é‚®ä»¶çš„åˆ†ç±»è§„åˆ™ï¼šä½ å¯ä»¥è®¾ç½®åªæ¥æ”¶æŸäº›å‘ä»¶äººçš„é‚®ä»¶ï¼Œæˆ–è€…æ’é™¤åƒåœ¾é‚®ä»¶ã€‚åœ¨MySQLå¤åˆ¶ä¸­ï¼Œè¿‡æ»¤è§„åˆ™å†³å®šäº†å“ªäº›æ•°æ®åº“ã€è¡¨æˆ–æ“ä½œéœ€è¦åŒæ­¥åˆ°ä»åº“ï¼Œå“ªäº›å¯ä»¥å¿½ç•¥ã€‚

**ğŸ“‹ è¿‡æ»¤è§„åˆ™ç±»å‹**
```
å¤åˆ¶è¿‡æ»¤åˆ†ç±»ï¼š
â”œâ”€â”€ æ•°æ®åº“çº§è¿‡æ»¤
â”‚   â”œâ”€â”€ replicate-do-db: åªå¤åˆ¶æŒ‡å®šæ•°æ®åº“
â”‚   â””â”€â”€ replicate-ignore-db: å¿½ç•¥æŒ‡å®šæ•°æ®åº“
â”œâ”€â”€ è¡¨çº§è¿‡æ»¤
â”‚   â”œâ”€â”€ replicate-do-table: åªå¤åˆ¶æŒ‡å®šè¡¨
â”‚   â”œâ”€â”€ replicate-ignore-table: å¿½ç•¥æŒ‡å®šè¡¨
â”‚   â”œâ”€â”€ replicate-wild-do-table: é€šé…ç¬¦åŒ¹é…å¤åˆ¶
â”‚   â””â”€â”€ replicate-wild-ignore-table: é€šé…ç¬¦åŒ¹é…å¿½ç•¥
â””â”€â”€ ç‰¹æ®Šè¿‡æ»¤
    â”œâ”€â”€ replicate-rewrite-db: æ•°æ®åº“é‡å‘½å
    â””â”€â”€ slave-skip-errors: è·³è¿‡ç‰¹å®šé”™è¯¯
```

### 8.2 è¿‡æ»¤è§„åˆ™é…ç½®


**âš™ï¸ é…ç½®æ–‡ä»¶è®¾ç½®æ–¹å¼**
```ini
# my.cnf ä¸­é…ç½®å¤åˆ¶è¿‡æ»¤è§„åˆ™
[mysqld]
# åªå¤åˆ¶æŒ‡å®šæ•°æ®åº“
replicate-do-db = important_db
replicate-do-db = user_data

# å¿½ç•¥æŒ‡å®šæ•°æ®åº“  
replicate-ignore-db = test
replicate-ignore-db = temp_db

# åªå¤åˆ¶æŒ‡å®šè¡¨
replicate-do-table = important_db.users
replicate-do-table = important_db.orders

# ä½¿ç”¨é€šé…ç¬¦è¿‡æ»¤
replicate-wild-do-table = shop_%.order_%
replicate-wild-ignore-table = log_%.%

# æ•°æ®åº“é‡å†™è§„åˆ™
replicate-rewrite-db = old_name->new_name
```

**ğŸ”§ åŠ¨æ€è®¾ç½®è¿‡æ»¤è§„åˆ™**
```sql
-- æ³¨æ„ï¼šå¤§éƒ¨åˆ†è¿‡æ»¤è§„åˆ™éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
-- åªæœ‰å°‘æ•°å¯ä»¥åŠ¨æ€ä¿®æ”¹

-- æŸ¥çœ‹å½“å‰è¿‡æ»¤è§„åˆ™
SHOW SLAVE STATUS\G
-- æŸ¥çœ‹ï¼š
-- Replicate_Do_DB
-- Replicate_Ignore_DB  
-- Replicate_Do_Table
-- Replicate_Ignore_Table
-- Replicate_Wild_Do_Table
-- Replicate_Wild_Ignore_Table

-- åŠ¨æ€è·³è¿‡é”™è¯¯ï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼‰
SET GLOBAL sql_slave_skip_counter = 1;
```

### 8.3 è¿‡æ»¤è§„åˆ™æ•…éšœè¯Šæ–­


**ğŸ” è¿‡æ»¤è§„åˆ™é—®é¢˜æ£€æŸ¥**
```sql
-- 1. æ£€æŸ¥å½“å‰ç”Ÿæ•ˆçš„è¿‡æ»¤è§„åˆ™
SHOW SLAVE STATUS\G

-- 2. æ£€æŸ¥é…ç½®æ–‡ä»¶
-- æŸ¥çœ‹ my.cnf ä¸­çš„ replicate-* é…ç½®

-- 3. æµ‹è¯•è¿‡æ»¤æ•ˆæœ
-- åœ¨ä¸»åº“åˆ›å»ºæµ‹è¯•æ•°æ®
CREATE DATABASE test_filter;
USE test_filter;
CREATE TABLE test_table (id INT, name VARCHAR(50));
INSERT INTO test_table VALUES (1, 'test');

-- åœ¨ä»åº“æ£€æŸ¥æ˜¯å¦åŒæ­¥
USE test_filter;  -- å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œè¯´æ˜è¢«è¿‡æ»¤äº†
SELECT * FROM test_table;  -- å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œè¯´æ˜è¢«è¿‡æ»¤äº†
```

**ğŸ“Š è¿‡æ»¤è§„åˆ™æ•ˆæœéªŒè¯**
```bash
#!/bin/bash
# è¿‡æ»¤è§„åˆ™éªŒè¯è„šæœ¬

# æ£€æŸ¥æ•°æ®åº“è¿‡æ»¤æ•ˆæœ
check_db_filter() {
    local db_name=$1
    
    # æ£€æŸ¥ä¸»åº“æ˜¯å¦å­˜åœ¨
    master_exists=$(mysql -hä¸»åº“IP -uç”¨æˆ· -på¯†ç  -e "SHOW DATABASES LIKE '$db_name';" | wc -l)
    
    # æ£€æŸ¥ä»åº“æ˜¯å¦å­˜åœ¨
    slave_exists=$(mysql -e "SHOW DATABASES LIKE '$db_name';" | wc -l)
    
    if [ $master_exists -gt 1 ] && [ $slave_exists -eq 1 ]; then
        echo "æ•°æ®åº“ $db_name åœ¨ä¸»åº“å­˜åœ¨ï¼Œä»åº“è¢«è¿‡æ»¤ - ç¬¦åˆé¢„æœŸ"
    elif [ $master_exists -gt 1 ] && [ $slave_exists -gt 1 ]; then
        echo "æ•°æ®åº“ $db_name åœ¨ä¸»ä»åº“éƒ½å­˜åœ¨ - æ­£å¸¸åŒæ­¥"
    else
        echo "æ•°æ®åº“ $db_name çŠ¶æ€å¼‚å¸¸ï¼Œéœ€è¦æ£€æŸ¥"
    fi
}

# æµ‹è¯•å¤šä¸ªæ•°æ®åº“
check_db_filter "test"
check_db_filter "important_db"
check_db_filter "user_data"
```

### 8.4 è¿‡æ»¤è§„åˆ™å†²çªè§£å†³


**âš ï¸ å¸¸è§è¿‡æ»¤å†²çª**
```sql
-- å†²çªç¤ºä¾‹1ï¼šdo-db å’Œ ignore-db åŒæ—¶è®¾ç½®
-- å¯èƒ½å¯¼è‡´å¤åˆ¶åœæ­¢æˆ–è¡Œä¸ºä¸å¯é¢„æœŸ

-- å†²çªç¤ºä¾‹2ï¼šè¡¨çº§è¿‡æ»¤å’Œæ•°æ®åº“çº§è¿‡æ»¤å†²çª
-- replicate-do-db = db1
-- replicate-ignore-table = db1.table1
-- è¿™ç§æƒ…å†µä¸‹ table1 å¯èƒ½ä»ç„¶è¢«å¤åˆ¶

-- æ£€æŸ¥å†²çªçš„æ–¹æ³•
SHOW SLAVE STATUS\G
-- å¦‚æœçœ‹åˆ°è¿‡æ»¤è§„åˆ™å¾ˆå¤æ‚ï¼Œéœ€è¦ç®€åŒ–
```

**ğŸ”§ è¿‡æ»¤è§„åˆ™ä¼˜åŒ–**
```ini
# æ¨èçš„è¿‡æ»¤é…ç½®æ–¹å¼

# æ–¹å¼1ï¼šåªç”¨æ•°æ®åº“çº§è¿‡æ»¤ï¼ˆç®€å•æ˜ç¡®ï¼‰
[mysqld]
replicate-do-db = prod_db1
replicate-do-db = prod_db2
# ä¸è¦æ··ç”¨ ignore-db

# æ–¹å¼2ï¼šåªç”¨è¡¨çº§è¿‡æ»¤ï¼ˆç²¾ç¡®æ§åˆ¶ï¼‰
[mysqld]  
replicate-do-table = db1.important_table1
replicate-do-table = db1.important_table2
replicate-do-table = db2.user_table

# æ–¹å¼3ï¼šä½¿ç”¨é€šé…ç¬¦ï¼ˆçµæ´»ä½†è¦å°å¿ƒï¼‰
[mysqld]
replicate-wild-do-table = prod_%.%
replicate-wild-ignore-table = %.temp_%
```

### 8.5 è¿‡æ»¤è§„åˆ™æœ€ä½³å®è·µ


**ğŸ’¡ è¿‡æ»¤è§„åˆ™è®¾è®¡åŸåˆ™**
```
è¿‡æ»¤è§„åˆ™æœ€ä½³å®è·µï¼š
âœ… ä¼˜å…ˆä½¿ç”¨ç™½åå•ï¼ˆdo-*ï¼‰è€Œä¸æ˜¯é»‘åå•ï¼ˆignore-*ï¼‰
âœ… å°½é‡åœ¨æ•°æ®åº“çº§åˆ«è¿‡æ»¤ï¼Œé¿å…è¡¨çº§å¤æ‚è§„åˆ™
âœ… è¿‡æ»¤è§„åˆ™è¦ç®€å•æ˜ç¡®ï¼Œé¿å…å¤šå±‚åµŒå¥—
âœ… æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯è§„åˆ™æ•ˆæœ
âœ… æ–‡æ¡£åŒ–æ‰€æœ‰è¿‡æ»¤è§„åˆ™çš„ç›®çš„å’Œå½±å“

âš ï¸ é¿å…çš„åšæ³•ï¼š
âŒ åŒæ—¶ä½¿ç”¨ do å’Œ ignore è§„åˆ™
âŒ è¿‡åº¦å¤æ‚çš„é€šé…ç¬¦è§„åˆ™  
âŒ é¢‘ç¹ä¿®æ”¹è¿‡æ»¤è§„åˆ™
âŒ æ²¡æœ‰å¤‡ä»½åŸå§‹é…ç½®
```

**ğŸ“ è¿‡æ»¤è§„åˆ™å˜æ›´æµç¨‹**
```bash
#!/bin/bash
# å®‰å…¨çš„è¿‡æ»¤è§„åˆ™å˜æ›´æµç¨‹

# 1. å¤‡ä»½å½“å‰é…ç½®
cp /etc/my.cnf /etc/my.cnf.backup.$(date +%Y%m%d)

# 2. è®°å½•å½“å‰å¤åˆ¶çŠ¶æ€
mysql -e "SHOW SLAVE STATUS\G" > /tmp/slave_status_before.txt

# 3. åœæ­¢å¤åˆ¶
mysql -e "STOP SLAVE;"

# 4. ä¿®æ”¹é…ç½®æ–‡ä»¶
# vim /etc/my.cnf

# 5. é‡å¯MySQLæœåŠ¡
systemctl restart mysqld

# 6. å¯åŠ¨å¤åˆ¶å¹¶æ£€æŸ¥
mysql -e "START SLAVE;"
mysql -e "SHOW SLAVE STATUS\G" > /tmp/slave_status_after.txt

# 7. éªŒè¯è¿‡æ»¤æ•ˆæœ
# åˆ›å»ºæµ‹è¯•æ•°æ®éªŒè¯è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ

echo "è¿‡æ»¤è§„åˆ™å˜æ›´å®Œæˆï¼Œè¯·æ£€æŸ¥å¤åˆ¶çŠ¶æ€"
```

---

## 9. ğŸ”„ æ•°æ®ä¸ä¸€è‡´ä¿®å¤


### 9.1 æ•°æ®ä¸ä¸€è‡´çš„äº§ç”ŸåŸå› 


**ğŸ¤” ä¸ºä»€ä¹ˆä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ï¼Ÿ**
> æƒ³è±¡ä¸¤ä¸ªå›¾ä¹¦é¦†è¦ä¿æŒè—ä¹¦ä¸€è‡´ï¼Œä½†ä¸­é€”å‡ºç°äº†é—®é¢˜ï¼šå¯èƒ½æ˜¯è¿è¾“é€”ä¸­ä¸¢å¤±äº†å‡ æœ¬ä¹¦ã€ç®¡ç†å‘˜è¯¯æ“ä½œã€æˆ–è€…æŸäº›ä¹¦ç±æŸåæ— æ³•ä½¿ç”¨ã€‚MySQLä¸»ä»ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ä¹Ÿæ˜¯ç±»ä¼¼çš„æƒ…å†µã€‚

**ğŸ“Š ä¸ä¸€è‡´äº§ç”Ÿçš„å¸¸è§åŸå› **
```
æ•°æ®ä¸ä¸€è‡´åŸå› åˆ†æï¼š
â”œâ”€â”€ å¤åˆ¶ä¸­æ–­ (35%)
â”‚   â”œâ”€â”€ ç½‘ç»œä¸­æ–­å¯¼è‡´éƒ¨åˆ†æ•°æ®ä¸¢å¤±
â”‚   â”œâ”€â”€ ä»åº“å®•æœºæœŸé—´æ•°æ®ä¸¢å¤±
â”‚   â””â”€â”€ binlogæ–‡ä»¶æŸåæˆ–ä¸¢å¤±
â”œâ”€â”€ äººä¸ºæ“ä½œ (30%)
â”‚   â”œâ”€â”€ ç›´æ¥åœ¨ä»åº“è¿›è¡Œå†™æ“ä½œ
â”‚   â”œâ”€â”€ è¯¯åˆ é™¤ä»åº“æ•°æ®
â”‚   â””â”€â”€ ä¸å½“çš„æ•…éšœæ¢å¤æ“ä½œ
â”œâ”€â”€ å¤åˆ¶é”™è¯¯ (20%)
â”‚   â”œâ”€â”€ SQLæ‰§è¡Œé”™è¯¯è¢«è·³è¿‡
â”‚   â”œâ”€â”€ å­—ç¬¦é›†æˆ–æ ¡å¯¹è§„åˆ™å·®å¼‚
â”‚   â””â”€â”€ äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ä¸€è‡´
â””â”€â”€ ç³»ç»Ÿæ•…éšœ (15%)
    â”œâ”€â”€ ç£ç›˜æ•…éšœå¯¼è‡´æ•°æ®æŸå
    â”œâ”€â”€ å†…å­˜é”™è¯¯å¯¼è‡´æ•°æ®å¼‚å¸¸
    â””â”€â”€ MySQL Bugå¯¼è‡´å¤åˆ¶å¼‚å¸¸
```

### 9.2 æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥


**ğŸ” åŸºç¡€ä¸€è‡´æ€§æ£€æŸ¥**
```sql
-- 1. æ£€æŸ¥è¡¨ç»“æ„ä¸€è‡´æ€§
-- åœ¨ä¸»åº“æ‰§è¡Œï¼š
SELECT TABLE_SCHEMA, TABLE_NAME, ENGINE, TABLE_ROWS, DATA_LENGTH
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
ORDER BY TABLE_SCHEMA, TABLE_NAME;

-- åœ¨ä»åº“æ‰§è¡ŒåŒæ ·çš„æŸ¥è¯¢ï¼Œå¯¹æ¯”ç»“æœ

-- 2. æ£€æŸ¥è¡¨è®°å½•æ•°ä¸€è‡´æ€§
-- ä¸»åº“ï¼š
SELECT 'user_table' AS table_name, COUNT(*) AS row_count FROM user_table
UNION ALL
SELECT 'order_table' AS table_name, COUNT(*) AS row_count FROM order_table;

-- ä»åº“æ‰§è¡ŒåŒæ ·æŸ¥è¯¢å¯¹æ¯”
```

**ğŸ› ï¸ è‡ªåŠ¨åŒ–ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬**
```bash
#!/bin/bash
# æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬

MASTER_HOST="ä¸»åº“IP"
MASTER_USER="æ£€æŸ¥ç”¨æˆ·"
MASTER_PASS="å¯†ç "
DATABASE="ç›®æ ‡æ•°æ®åº“"

# è·å–æ‰€æœ‰è¡¨çš„è®°å½•æ•°
get_table_counts() {
    local host=$1
    local is_master=$2
    
    if [ "$is_master" = "true" ]; then
        mysql -h$host -u$MASTER_USER -p$MASTER_PASS $DATABASE -e "
            SELECT TABLE_NAME, TABLE_ROWS 
            FROM information_schema.TABLES 
            WHERE TABLE_SCHEMA='$DATABASE' 
            ORDER BY TABLE_NAME;" > master_counts.txt
    else
        mysql -u$MASTER_USER -p$MASTER_PASS $DATABASE -e "
            SELECT TABLE_NAME, TABLE_ROWS 
            FROM information_schema.TABLES 
            WHERE TABLE_SCHEMA='$DATABASE' 
            ORDER BY TABLE_NAME;" > slave_counts.txt
    fi
}

# æ¯”è¾ƒä¸»ä»æ•°æ®é‡
compare_counts() {
    echo "=== æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š ==="
    echo "æ£€æŸ¥æ—¶é—´: $(date)"
    echo ""
    
    # è·å–ä¸»ä»æ•°æ®
    get_table_counts $MASTER_HOST true
    get_table_counts "localhost" false
    
    # æ¯”è¾ƒç»“æœ
    echo "è¡¨å\t\tä¸»åº“è®°å½•æ•°\tä»åº“è®°å½•æ•°\tçŠ¶æ€"
    echo "--------------------------------------------"
    
    while read -r table_name master_count; do
        if [ "$table_name" != "TABLE_NAME" ]; then
            slave_count=$(grep "^$table_name" slave_counts.txt | awk '{print $2}')
            
            if [ "$master_count" = "$slave_count" ]; then
                status="âœ… ä¸€è‡´"
            else
                status="âŒ ä¸ä¸€è‡´"
            fi
            
            echo -e "$table_name\t\t$master_count\t\t$slave_count\t\t$status"
        fi
    done < master_counts.txt
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f master_counts.txt slave_counts.txt
}

# æ‰§è¡Œæ£€æŸ¥
compare_counts
```

### 9.3 ä½¿ç”¨pt-table-checksumæ£€æŸ¥


**ğŸ”§ Percona Toolkitæ£€æŸ¥å·¥å…·**
```bash
# å®‰è£… Percona Toolkit
yum install percona-toolkit

# ä½¿ç”¨ pt-table-checksum æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
pt-table-checksum \
    --no-check-binlog-format \
    --no-check-replication-filters \
    --replicate=percona.checksums \
    --databases=your_database \
    --chunk-size=1000 \
    h=ä¸»åº“IP,u=æ£€æŸ¥ç”¨æˆ·,p=å¯†ç 

# æŸ¥çœ‹æ£€æŸ¥ç»“æœ
mysql -e "SELECT * FROM percona.checksums WHERE master_cnt <> slave_cnt OR master_crc <> slave_crc OR slave_cnt IS NULL;"
```

**ğŸ“Š pt-table-checksumç»“æœè§£è¯»**
```sql
-- æ£€æŸ¥ç»“æœè¡¨ç»“æ„
SELECT * FROM percona.checksums LIMIT 1;

-- é‡è¦å­—æ®µè¯´æ˜ï¼š
-- db: æ•°æ®åº“å
-- tbl: è¡¨å  
-- chunk: æ•°æ®å—ç¼–å·
-- master_cnt: ä¸»åº“è¯¥å—è®°å½•æ•°
-- slave_cnt: ä»åº“è¯¥å—è®°å½•æ•°
-- master_crc: ä¸»åº“è¯¥å—æ ¡éªŒå’Œ
-- slave_crc: ä»åº“è¯¥å—æ ¡éªŒå’Œ

-- æŸ¥æ‰¾ä¸ä¸€è‡´çš„æ•°æ®å—
SELECT db, tbl, chunk, 
       master_cnt, slave_cnt,
       master_crc, slave_crc
FROM percona.checksums 
WHERE master_cnt <> slave_cnt 
   OR master_crc <> slave_crc 
   OR slave_cnt IS NULL;
```

### 9.4 æ•°æ®ä¸ä¸€è‡´ä¿®å¤æ–¹æ³•


**ğŸ› ï¸ ä½¿ç”¨pt-table-syncä¿®å¤**
```bash
# ä¿®å¤å‘ç°çš„ä¸ä¸€è‡´æ•°æ®
pt-table-sync \
    --execute \
    --sync-to-master \
    --databases=your_database \
    --tables=problem_table \
    h=ä»åº“IP,u=ä¿®å¤ç”¨æˆ·,p=å¯†ç 

# å‚æ•°è¯´æ˜ï¼š
# --execute: çœŸæ­£æ‰§è¡Œä¿®å¤ï¼ˆå»æ‰æ­¤å‚æ•°åªæ˜¯é¢„è§ˆï¼‰
# --sync-to-master: ä»¥ä¸»åº“æ•°æ®ä¸ºå‡†ä¿®å¤ä»åº“
# --print: æ˜¾ç¤ºä¿®å¤çš„SQLè¯­å¥
# --dry-run: åªæ£€æŸ¥ä¸æ‰§è¡Œ
```

**ğŸ”§ æ‰‹å·¥æ•°æ®ä¿®å¤æ–¹æ³•**
```sql
-- æ–¹æ³•1ï¼šé‡æ–°å¯¼å…¥å•ä¸ªè¡¨æ•°æ®
-- 1. åœ¨ä»åº“åœæ­¢å¤åˆ¶
STOP SLAVE;

-- 2. ä»ä¸»åº“å¯¼å‡ºè¡¨æ•°æ®
-- åœ¨ä¸»åº“æ‰§è¡Œï¼š
mysqldump -hä¸»åº“IP -uç”¨æˆ· -på¯†ç  --single-transaction --routines --triggers æ•°æ®åº“å è¡¨å > table_data.sql

-- 3. åœ¨ä»åº“æ¢å¤æ•°æ®
-- å…ˆå¤‡ä»½ä»åº“å½“å‰æ•°æ®
mysqldump -uç”¨æˆ· -på¯†ç  æ•°æ®åº“å è¡¨å > slave_table_backup.sql

-- åˆ é™¤ä»åº“è¡¨æ•°æ®å¹¶é‡æ–°å¯¼å…¥
mysql -uç”¨æˆ· -på¯†ç  æ•°æ®åº“å -e "TRUNCATE TABLE è¡¨å;"
mysql -uç”¨æˆ· -på¯†ç  æ•°æ®åº“å < table_data.sql

-- 4. é‡æ–°å¯åŠ¨å¤åˆ¶
START SLAVE;
```

### 9.5 é‡å»ºä»åº“æ–¹æ¡ˆ


**ğŸ”„ å®Œå…¨é‡å»ºä»åº“**
```bash
#!/bin/bash
# ä»åº“å®Œå…¨é‡å»ºè„šæœ¬

MASTER_HOST="ä¸»åº“IP"
MASTER_USER="å¤åˆ¶ç”¨æˆ·"
MASTER_PASS="å¯†ç "
DATABASE="ç›®æ ‡æ•°æ®åº“"

echo "å¼€å§‹é‡å»ºä»åº“ï¼Œè¿™å°†æ¸…é™¤æ‰€æœ‰ä»åº“æ•°æ®..."
read -p "ç¡®è®¤ç»§ç»­ï¼Ÿ(yes/no): " confirm

if [ "$confirm" != "yes" ]; then
    echo "æ“ä½œå–æ¶ˆ"
    exit 1
fi

# 1. åœæ­¢ä»åº“å¤åˆ¶
mysql -e "STOP SLAVE;"

# 2. ä»ä¸»åº“åˆ›å»ºä¸€è‡´æ€§å¤‡ä»½
mysqldump -h$MASTER_HOST -u$MASTER_USER -p$MASTER_PASS \
    --single-transaction \
    --routines \
    --triggers \
    --master-data=2 \
    --all-databases > master_backup.sql

# 3. è·å–å¤‡ä»½æ—¶çš„ä½ç‚¹ä¿¡æ¯
BINLOG_FILE=$(grep "CHANGE MASTER TO" master_backup.sql | sed -n 's/.*MASTER_LOG_FILE='\''//p' | sed 's/'\''.*//')
BINLOG_POS=$(grep "CHANGE MASTER TO" master_backup.sql | sed -n 's/.*MASTER_LOG_POS=//p' | sed 's/;.*//')

echo "å¤‡ä»½æ—¶ä½ç‚¹: $BINLOG_FILE, $BINLOG_POS"

# 4. æ¢å¤æ•°æ®åˆ°ä»åº“
mysql < master_backup.sql

# 5. é‡æ–°é…ç½®å¤åˆ¶
mysql -e "
CHANGE MASTER TO
    MASTER_HOST='$MASTER_HOST',
    MASTER_USER='$MASTER_USER',
    MASTER_PASSWORD='$MASTER_PASS',
    MASTER_LOG_FILE='$BINLOG_FILE',
    MASTER_LOG_POS=$BINLOG_POS;
"

# 6. å¯åŠ¨å¤åˆ¶
mysql -e "START SLAVE;"

# 7. æ£€æŸ¥å¤åˆ¶çŠ¶æ€
mysql -e "SHOW SLAVE STATUS\G"

echo "ä»åº“é‡å»ºå®Œæˆï¼"
```

**âš¡ åœ¨çº¿é‡å»ºæ–¹æ¡ˆï¼ˆé€‚ç”¨äºå¤§æ•°æ®åº“ï¼‰**
```bash
# ä½¿ç”¨ XtraBackup è¿›è¡Œåœ¨çº¿å¤‡ä»½æ¢å¤
# 1. åœ¨ä¸»åº“åˆ›å»ºçƒ­å¤‡ä»½
xtrabackup --backup --target-dir=/backup/full --user=backup_user --password=password

# 2. ä¼ è¾“å¤‡ä»½åˆ°ä»åº“
rsync -avz /backup/full/ ä»åº“IP:/backup/restore/

# 3. åœ¨ä»åº“å‡†å¤‡å¤‡ä»½
xtrabackup --prepare --target-dir=/backup/restore

# 4. åœæ­¢ä»åº“MySQL
systemctl stop mysqld

# 5. æ¢å¤æ•°æ®
xtrabackup --copy-back --target-dir=/backup/restore

# 6. ä¿®å¤æƒé™
chown -R mysql:mysql /var/lib/mysql

# 7. å¯åŠ¨MySQLå¹¶é…ç½®å¤åˆ¶
systemctl start mysqld
# é…ç½®å¤åˆ¶å‚æ•°...
```

---

## 10. ğŸ‘¤ å¤åˆ¶ç”¨æˆ·æƒé™é—®é¢˜


### 10.1 å¤åˆ¶ç”¨æˆ·æƒé™åŸºç¡€


**ğŸ” ä»€ä¹ˆæ˜¯å¤åˆ¶ç”¨æˆ·ï¼Ÿ**
> å¤åˆ¶ç”¨æˆ·å°±åƒæ˜¯ä¸“é—¨è´Ÿè´£"æ•°æ®ä¼ è¾“"çš„å¿«é€’å‘˜ã€‚è¿™ä¸ªç”¨æˆ·éœ€è¦æœ‰ä»ä¸»åº“è¯»å–æ•°æ®å˜æ›´è®°å½•çš„æƒé™ï¼Œä½†ä¸éœ€è¦æœ‰ä¿®æ”¹æ•°æ®çš„æƒé™ã€‚å¦‚æœå¿«é€’å‘˜çš„"é€šè¡Œè¯"æœ‰é—®é¢˜ï¼Œæ•°æ®å°±æ— æ³•æ­£å¸¸ä¼ è¾“ã€‚

**ğŸ“‹ å¤åˆ¶ç”¨æˆ·å¿…éœ€æƒé™**
```sql
-- å¤åˆ¶ç”¨æˆ·æœ€å°æƒé™é›†åˆ
CREATE USER 'repl_user'@'ä»åº“IP' IDENTIFIED BY 'strong_password';

-- å¿…éœ€çš„åŸºç¡€æƒé™
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'ä»åº“IP';

-- å¯é€‰çš„ç›‘æ§æƒé™ï¼ˆç”¨äºçŠ¶æ€æ£€æŸ¥ï¼‰
GRANT REPLICATION CLIENT ON *.* TO 'repl_user'@'ä»åº“IP';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;
```

### 10.2 æƒé™é—®é¢˜è¯Šæ–­


**ğŸ” æƒé™æ£€æŸ¥æ–¹æ³•**
```sql
-- 1. æ£€æŸ¥å¤åˆ¶ç”¨æˆ·æ˜¯å¦å­˜åœ¨
SELECT User, Host, authentication_string FROM mysql.user 
WHERE User = 'repl_user';

-- 2. æ£€æŸ¥ç”¨æˆ·æƒé™
SHOW GRANTS FOR 'repl_user'@'ä»åº“IP';

-- 3. æ£€æŸ¥æƒé™ç›¸å…³çš„ç³»ç»Ÿè¡¨
SELECT * FROM mysql.user WHERE User = 'repl_user'\G

-- 4. æµ‹è¯•ç”¨æˆ·è¿æ¥
-- åœ¨ä»åº“æ‰§è¡Œï¼š
mysql -hä¸»åº“IP -u repl_user -på¯†ç  -e "SHOW MASTER STATUS;"
```

**âš ï¸ å¸¸è§æƒé™é”™è¯¯**
```sql
-- é”™è¯¯1ï¼šç”¨æˆ·ä¸å­˜åœ¨
Last_IO_Error: error connecting to master 'repl_user@ä¸»åº“IP:3306' - 
retry-time: 60 retries: 1

-- é”™è¯¯2ï¼šå¯†ç é”™è¯¯
Last_IO_Error: error connecting to master 'repl_user@ä¸»åº“IP:3306' - 
retry-time: 60 retries: 1 message: Access denied for user 'repl_user'@'ä»åº“IP'

-- é”™è¯¯3ï¼šæƒé™ä¸è¶³
Last_IO_Error: error connecting to master 'repl_user@ä¸»åº“IP:3306' - 
retry-time: 60 retries: 1 message: Access denied; you need (at least one of) the REPLICATION SLAVE privilege(s)
```

### 10.3 æƒé™é—®é¢˜ä¿®å¤


**ğŸ”§ æƒé™ä¿®å¤æ­¥éª¤**
```sql
-- 1. é‡æ–°åˆ›å»ºå¤åˆ¶ç”¨æˆ·ï¼ˆå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼‰
DROP USER IF EXISTS 'repl_user'@'ä»åº“IP';
CREATE USER 'repl_user'@'ä»åº“IP' IDENTIFIED BY 'new_strong_password';

-- 2. æˆäºˆæ­£ç¡®çš„æƒé™
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'ä»åº“IP';
GRANT REPLICATION CLIENT ON *.* TO 'repl_user'@'ä»åº“IP';

-- 3. åˆ·æ–°æƒé™
FLUSH PRIVILEGES;

-- 4. åœ¨ä»åº“æ›´æ–°è¿æ¥ä¿¡æ¯
STOP SLAVE;
CHANGE MASTER TO
    MASTER_USER = 'repl_user',
    MASTER_PASSWORD = 'new_strong_password';
START SLAVE;
```

**ğŸ›¡ï¸ å®‰å…¨çš„æƒé™é…ç½®**
```sql
-- æœ€ä½³å®è·µçš„å¤åˆ¶ç”¨æˆ·é…ç½®

-- 1. ä½¿ç”¨å¼ºå¯†ç 
CREATE USER 'repl_user'@'ä»åº“IP' IDENTIFIED BY 'Complex_Password_123!';

-- 2. é™åˆ¶è¿æ¥æ¥æºï¼ˆå…·ä½“IPè€Œä¸æ˜¯%ï¼‰
-- æ¨èï¼š'repl_user'@'192.168.1.100'
-- é¿å…ï¼š'repl_user'@'%'

-- 3. æœ€å°æƒé™åŸåˆ™
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'ä»åº“IP';
-- ä¸è¦ç»™äºˆå…¶ä»–ä¸å¿…è¦çš„æƒé™

-- 4. å®šæœŸæ›´æ¢å¯†ç 
-- å»ºè®®æ¯å­£åº¦æ›´æ¢ä¸€æ¬¡å¤åˆ¶ç”¨æˆ·å¯†ç 

-- 5. ç›‘æ§ç”¨æˆ·ä½¿ç”¨æƒ…å†µ
SELECT * FROM information_schema.PROCESSLIST 
WHERE USER = 'repl_user';
```

### 10.4 å¤šä»åº“æƒé™ç®¡ç†


**ğŸ”„ å¤šä»åº“ç¯å¢ƒæƒé™é…ç½®**
```sql
-- ä¸ºå¤šä¸ªä»åº“åˆ›å»ºå¤åˆ¶ç”¨æˆ·

-- æ–¹æ³•1ï¼šæ¯ä¸ªä»åº“å•ç‹¬çš„ç”¨æˆ·ï¼ˆæ¨èï¼‰
CREATE USER 'repl_slave1'@'192.168.1.101' IDENTIFIED BY 'password1';
CREATE USER 'repl_slave2'@'192.168.1.102' IDENTIFIED BY 'password2';
CREATE USER 'repl_slave3'@'192.168.1.103' IDENTIFIED BY 'password3';

GRANT REPLICATION SLAVE ON *.* TO 'repl_slave1'@'192.168.1.101';
GRANT REPLICATION SLAVE ON *.* TO 'repl_slave2'@'192.168.1.102';
GRANT REPLICATION SLAVE ON *.* TO 'repl_slave3'@'192.168.1.103';

-- æ–¹æ³•2ï¼šç»Ÿä¸€ç”¨æˆ·ï¼ˆç®€å•ä½†å®‰å…¨æ€§è¾ƒä½ï¼‰
CREATE USER 'repl_user'@'192.168.1.%' IDENTIFIED BY 'shared_password';
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'192.168.1.%';

FLUSH PRIVILEGES;
```

**ğŸ“Š æƒé™ç®¡ç†å¯¹æ¯”è¡¨**
| æ–¹æ¡ˆ | å®‰å…¨æ€§ | ç®¡ç†å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | ä¼˜ç¼ºç‚¹ |
|------|--------|------------|----------|--------|
| **å•ç‹¬ç”¨æˆ·** | â­â­â­â­ | ğŸ”§ğŸ”§ğŸ”§ | ç”Ÿäº§ç¯å¢ƒ | å®‰å…¨æ€§é«˜ï¼Œä½†ç®¡ç†å¤æ‚ |
| **ç»Ÿä¸€ç”¨æˆ·** | â­â­ | ğŸ”§ | æµ‹è¯•ç¯å¢ƒ | ç®¡ç†ç®€å•ï¼Œä½†å®‰å…¨æ€§è¾ƒä½ |
| **ç½‘æ®µç”¨æˆ·** | â­â­â­ | ğŸ”§ğŸ”§ | ä¸­å‹ç¯å¢ƒ | å¹³è¡¡å®‰å…¨æ€§å’Œç®¡ç†å¤æ‚åº¦ |

### 10.5 æƒé™æ•…éšœæ’é™¤æµç¨‹


**ğŸ” æƒé™é—®é¢˜è¯Šæ–­æµç¨‹**
```bash
#!/bin/bash
# å¤åˆ¶ç”¨æˆ·æƒé™è¯Šæ–­è„šæœ¬

MASTER_HOST="ä¸»åº“IP"
SLAVE_HOST="ä»åº“IP"
REPL_USER="repl_user"

echo "=== MySQLå¤åˆ¶ç”¨æˆ·æƒé™è¯Šæ–­ ==="
echo "è¯Šæ–­æ—¶é—´: $(date)"
echo ""

# 1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
check_user_exists() {
    echo "1. æ£€æŸ¥å¤åˆ¶ç”¨æˆ·æ˜¯å¦å­˜åœ¨..."
    user_count=$(mysql -h$MASTER_HOST -e "SELECT COUNT(*) FROM mysql.user WHERE User='$REPL_USER' AND Host='$SLAVE_HOST';" -s)
    
    if [ "$user_count" -eq 1 ]; then
        echo "âœ… ç”¨æˆ· $REPL_USER@$SLAVE_HOST å­˜åœ¨"
        return 0
    else
        echo "âŒ ç”¨æˆ· $REPL_USER@$SLAVE_HOST ä¸å­˜åœ¨"
        return 1
    fi
}

# 2. æ£€æŸ¥ç”¨æˆ·æƒé™
check_user_privileges() {
    echo "2. æ£€æŸ¥ç”¨æˆ·æƒé™..."
    repl_priv=$(mysql -h$MASTER_HOST -e "SELECT Repl_slave_priv FROM mysql.user WHERE User='$REPL_USER' AND Host='$SLAVE_HOST';" -s)
    
    if [ "$repl_priv" = "Y" ]; then
        echo "âœ… ç”¨æˆ·å…·æœ‰ REPLICATION SLAVE æƒé™"
        return 0
    else
        echo "âŒ ç”¨æˆ·ç¼ºå°‘ REPLICATION SLAVE æƒé™"
        return 1
    fi
}

# 3. æµ‹è¯•ç”¨æˆ·è¿æ¥
test_user_connection() {
    echo "3. æµ‹è¯•ç”¨æˆ·è¿æ¥..."
    if mysql -h$MASTER_HOST -u$REPL_USER -på¯†ç  -e "SELECT 1;" &>/dev/null; then
        echo "âœ… ç”¨æˆ·è¿æ¥æµ‹è¯•æˆåŠŸ"
        return 0
    else
        echo "âŒ ç”¨æˆ·è¿æ¥æµ‹è¯•å¤±è´¥"
        return 1
    fi
}

# 4. æ£€æŸ¥å¤åˆ¶çŠ¶æ€
check_replication_status() {
    echo "4. æ£€æŸ¥å½“å‰å¤åˆ¶çŠ¶æ€..."
    io_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_IO_Running:" | awk '{print $2}')
    
    if [ "$io_running" = "Yes" ]; then
        echo "âœ… IOçº¿ç¨‹æ­£å¸¸è¿è¡Œ"
    else
        echo "âŒ IOçº¿ç¨‹æœªè¿è¡Œ"
        last_error=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Last_IO_Error:" | cut -d: -f2-)
        echo "é”™è¯¯ä¿¡æ¯: $last_error"
    fi
}

# æ‰§è¡Œè¯Šæ–­
check_user_exists
check_user_privileges  
test_user_connection
check_replication_status

echo ""
echo "=== è¯Šæ–­å®Œæˆ ==="
```

**ğŸ› ï¸ æƒé™ä¿®å¤å»ºè®®æ–¹æ¡ˆ**
```sql
-- å®Œæ•´çš„æƒé™ä¿®å¤æµç¨‹

-- æ­¥éª¤1ï¼šå¤‡ä»½å½“å‰å¤åˆ¶çŠ¶æ€
-- åœ¨ä»åº“æ‰§è¡Œ
SHOW SLAVE STATUS\G
-- è®°å½•é‡è¦ä¿¡æ¯ï¼šMaster_Log_File, Read_Master_Log_Pos

-- æ­¥éª¤2ï¼šåœæ­¢å¤åˆ¶
STOP SLAVE;

-- æ­¥éª¤3ï¼šåœ¨ä¸»åº“ä¿®å¤æƒé™é—®é¢˜
-- åˆ é™¤æœ‰é—®é¢˜çš„ç”¨æˆ·
DROP USER IF EXISTS 'repl_user'@'ä»åº“IP';

-- é‡æ–°åˆ›å»ºç”¨æˆ·
CREATE USER 'repl_user'@'ä»åº“IP' IDENTIFIED BY 'new_strong_password';
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'ä»åº“IP';
GRANT REPLICATION CLIENT ON *.* TO 'repl_user'@'ä»åº“IP';
FLUSH PRIVILEGES;

-- æ­¥éª¤4ï¼šåœ¨ä»åº“æ›´æ–°è®¤è¯ä¿¡æ¯
CHANGE MASTER TO
    MASTER_USER = 'repl_user',
    MASTER_PASSWORD = 'new_strong_password';

-- æ­¥éª¤5ï¼šé‡æ–°å¯åŠ¨å¤åˆ¶
START SLAVE;

-- æ­¥éª¤6ï¼šéªŒè¯ä¿®å¤ç»“æœ
SHOW SLAVE STATUS\G
```

---

## 11. ğŸŒ ç½‘ç»œä¸­æ–­æ¢å¤ç­–ç•¥


### 11.1 ç½‘ç»œä¸­æ–­çš„å½±å“åˆ†æ


**ğŸ”Œ ç½‘ç»œä¸­æ–­å¯¹å¤åˆ¶çš„å½±å“**
> ç½‘ç»œä¸­æ–­å°±åƒä¸¤ä¸ªåŸå¸‚ä¹‹é—´çš„é“è·¯è¢«å µä½äº†ï¼Œä¿¡æ¯æ— æ³•æ­£å¸¸ä¼ é€’ã€‚MySQLå¤åˆ¶ä¾èµ–ç½‘ç»œè¿æ¥ï¼Œä¸€æ—¦ä¸­æ–­ï¼Œä»åº“å°±æ— æ³•è·å–ä¸»åº“çš„æœ€æ–°å˜æ›´ï¼Œå¯¼è‡´æ•°æ®é€æ¸ä¸åŒæ­¥ã€‚

**ğŸ“Š ç½‘ç»œä¸­æ–­åœºæ™¯åˆ†ç±»**
```
ç½‘ç»œä¸­æ–­ç±»å‹ï¼š
â”œâ”€â”€ ç¬æ—¶ä¸­æ–­ (< 1åˆ†é’Ÿ)
â”‚   â”œâ”€â”€ ç½‘ç»œæŠ–åŠ¨
â”‚   â”œâ”€â”€ äº¤æ¢æœºé‡å¯
â”‚   â””â”€â”€ è·¯ç”±è¡¨æ›´æ–°
â”œâ”€â”€ çŸ­æœŸä¸­æ–­ (1-30åˆ†é’Ÿ)
â”‚   â”œâ”€â”€ ç½‘ç»œè®¾å¤‡æ•…éšœ
â”‚   â”œâ”€â”€ é“¾è·¯ç»´æŠ¤
â”‚   â””â”€â”€ é˜²ç«å¢™ç­–ç•¥å˜æ›´
â”œâ”€â”€ é•¿æœŸä¸­æ–­ (> 30åˆ†é’Ÿ)
â”‚   â”œâ”€â”€ æœºæˆ¿æ–­ç½‘
â”‚   â”œâ”€â”€ è¿è¥å•†æ•…éšœ
â”‚   â””â”€â”€ ç½‘ç»œæ¶æ„è°ƒæ•´
â””â”€â”€ é—´æ­‡æ€§ä¸­æ–­
    â”œâ”€â”€ ç½‘ç»œä¸ç¨³å®š
    â”œâ”€â”€ å¸¦å®½æ‹¥å¡
    â””â”€â”€ ä¸¢åŒ…ä¸¥é‡
```

### 11.2 ç½‘ç»œä¸­æ–­æ£€æµ‹æœºåˆ¶


**ğŸ” ç½‘ç»œè¿æ¥ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# ç½‘ç»œè¿æ¥è´¨é‡ç›‘æ§è„šæœ¬

MASTER_IP="ä¸»åº“IP"
LOG_FILE="/var/log/mysql_network_monitor.log"

# ç½‘ç»œè¿é€šæ€§æ£€æµ‹
check_network_connectivity() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # 1. Pingæµ‹è¯•
    ping_result=$(ping -c 3 $MASTER_IP | grep "packet loss" | awk '{print $6}')
    
    # 2. MySQLç«¯å£è¿æ¥æµ‹è¯•
    if timeout 5 bash -c "</dev/tcp/$MASTER_IP/3306"; then
        mysql_port_status="âœ… å¯è¿æ¥"
    else
        mysql_port_status="âŒ æ— æ³•è¿æ¥"
    fi
    
    # 3. ç½‘ç»œå»¶è¿Ÿæµ‹è¯•
    ping_time=$(ping -c 1 $MASTER_IP | grep "time=" | awk -F'time=' '{print $2}' | awk '{print $1}')
    
    # è®°å½•ç»“æœ
    echo "[$timestamp] ä¸¢åŒ…ç‡: $ping_result, ç«¯å£çŠ¶æ€: $mysql_port_status, å»¶è¿Ÿ: ${ping_time}ms" >> $LOG_FILE
    
    # åˆ¤æ–­ç½‘ç»œè´¨é‡
    if [[ "$ping_result" == "0%" ]] && [[ "$mysql_port_status" == *"å¯è¿æ¥"* ]]; then
        return 0  # ç½‘ç»œæ­£å¸¸
    else
        return 1  # ç½‘ç»œå¼‚å¸¸
    fi
}

# å¤åˆ¶çŠ¶æ€æ£€æµ‹
check_replication_health() {
    local io_running=$(mysql -e "SHOW SLAVE STATUS\G" 2>/dev/null | grep "Slave_IO_Running:" | awk '{print $2}')
    local seconds_behind=$(mysql -e "SHOW SLAVE STATUS\G" 2>/dev/null | grep "Seconds_Behind_Master:" | awk '{print $2}')
    
    if [[ "$io_running" == "Yes" ]] && [[ "$seconds_behind" != "NULL" ]]; then
        echo "$(date): å¤åˆ¶çŠ¶æ€æ­£å¸¸ï¼Œå»¶è¿Ÿ ${seconds_behind}ç§’" >> $LOG_FILE
        return 0
    else
        echo "$(date): å¤åˆ¶çŠ¶æ€å¼‚å¸¸ï¼ŒIOè¿è¡Œ: $io_running, å»¶è¿Ÿ: $seconds_behind" >> $LOG_FILE
        return 1
    fi
}

# ä¸»ç›‘æ§å¾ªç¯
while true; do
    if ! check_network_connectivity; then
        echo "$(date): æ£€æµ‹åˆ°ç½‘ç»œè¿æ¥é—®é¢˜" >> $LOG_FILE
        
        # å‘é€å‘Šè­¦ï¼ˆå¯ä»¥è‡ªå®šä¹‰å‘Šè­¦æ–¹å¼ï¼‰
        # send_alert "MySQLå¤åˆ¶ç½‘ç»œè¿æ¥å¼‚å¸¸"
    fi
    
    if ! check_replication_health; then
        echo "$(date): æ£€æµ‹åˆ°å¤åˆ¶å¥åº·é—®é¢˜" >> $LOG_FILE
    fi
    
    sleep 30
done
```

### 11.3 è‡ªåŠ¨æ¢å¤æœºåˆ¶


**ğŸ”„ æ™ºèƒ½é‡è¿é…ç½®**
```sql
-- ä¼˜åŒ–ç½‘ç»œä¸­æ–­æ¢å¤çš„å‚æ•°è®¾ç½®
STOP SLAVE;

CHANGE MASTER TO
    MASTER_CONNECT_RETRY = 10,        -- é‡è¿é—´éš”10ç§’
    MASTER_RETRY_COUNT = 0,           -- æ— é™é‡è¯•ï¼ˆ0è¡¨ç¤ºæ— é™ï¼‰
    MASTER_HEARTBEAT_PERIOD = 30;     -- å¿ƒè·³é—´éš”30ç§’

-- é…ç½®ç½‘ç»œè¶…æ—¶å‚æ•°
SET GLOBAL slave_net_timeout = 120;   -- ç½‘ç»œè¶…æ—¶2åˆ†é’Ÿ
SET GLOBAL connect_timeout = 30;      -- è¿æ¥è¶…æ—¶30ç§’

START SLAVE;
```

**âš™ï¸ é…ç½®æ–‡ä»¶ä¼˜åŒ–è®¾ç½®**
```ini
# my.cnf ç½‘ç»œä¸­æ–­æ¢å¤ä¼˜åŒ–
[mysqld]
# åŸºç¡€ç½‘ç»œå‚æ•°
connect_timeout = 30
wait_timeout = 28800
interactive_timeout = 28800
net_read_timeout = 120
net_write_timeout = 120

# å¤åˆ¶é‡è¿å‚æ•°
master_connect_retry = 10
master_retry_count = 0
master_heartbeat_period = 30
slave_net_timeout = 120

# å¤åˆ¶ç¼“å†²ä¼˜åŒ–
slave_pending_jobs_size_max = 16M
relay_log_space_limit = 4G

# TCPå‚æ•°ä¼˜åŒ–ï¼ˆå¦‚æœæ”¯æŒï¼‰
bind_address = 0.0.0.0
skip_name_resolve = 1
```

### 11.4 ç½‘ç»œä¸­æ–­æ¢å¤æµç¨‹


**ğŸ› ï¸ æ‰‹åŠ¨ç½‘ç»œæ¢å¤æ­¥éª¤**
```bash
#!/bin/bash
# ç½‘ç»œä¸­æ–­åçš„æ¢å¤æµç¨‹è„šæœ¬

echo "=== MySQLå¤åˆ¶ç½‘ç»œä¸­æ–­æ¢å¤æµç¨‹ ==="

# 1. æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€
check_network() {
    echo "1. æ£€æŸ¥ç½‘ç»œè¿æ¥..."
    
    if ping -c 3 ä¸»åº“IP > /dev/null 2>&1; then
        echo "âœ… ç½‘ç»œpingæµ‹è¯•æ­£å¸¸"
    else
        echo "âŒ ç½‘ç»œpingæµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"
        exit 1
    fi
    
    if timeout 5 bash -c "</dev/tcp/ä¸»åº“IP/3306" > /dev/null 2>&1; then
        echo "âœ… MySQLç«¯å£è¿æ¥æ­£å¸¸"
    else
        echo "âŒ MySQLç«¯å£è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¸»åº“çŠ¶æ€"
        exit 1
    fi
}

# 2. æ£€æŸ¥å¤åˆ¶çŠ¶æ€
check_current_status() {
    echo "2. æ£€æŸ¥å½“å‰å¤åˆ¶çŠ¶æ€..."
    
    mysql -e "SHOW SLAVE STATUS\G" > /tmp/slave_status.txt
    
    io_running=$(grep "Slave_IO_Running:" /tmp/slave_status.txt | awk '{print $2}')
    sql_running=$(grep "Slave_SQL_Running:" /tmp/slave_status.txt | awk '{print $2}')
    last_error=$(grep "Last_IO_Error:" /tmp/slave_status.txt | cut -d: -f2-)
    
    echo "IOçº¿ç¨‹çŠ¶æ€: $io_running"
    echo "SQLçº¿ç¨‹çŠ¶æ€: $sql_running"
    
    if [[ -n "$last_error" && "$last_error" != " " ]]; then
        echo "æœ€åé”™è¯¯: $last_error"
    fi
}

# 3. å°è¯•é‡å¯å¤åˆ¶
restart_replication() {
    echo "3. å°è¯•é‡å¯å¤åˆ¶..."
    
    mysql -e "STOP SLAVE IO_THREAD;"
    echo "å·²åœæ­¢IOçº¿ç¨‹"
    
    sleep 5
    
    mysql -e "START SLAVE IO_THREAD;"
    echo "å·²å¯åŠ¨IOçº¿ç¨‹"
    
    sleep 10
    
    # æ£€æŸ¥æ¢å¤ç»“æœ
    io_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_IO_Running:" | awk '{print $2}')
    
    if [ "$io_running" = "Yes" ]; then
        echo "âœ… å¤åˆ¶æ¢å¤æˆåŠŸ"
        return 0
    else
        echo "âŒ å¤åˆ¶æ¢å¤å¤±è´¥"
        return 1
    fi
}

# 4. éªŒè¯æ•°æ®åŒæ­¥
verify_sync() {
    echo "4. éªŒè¯æ•°æ®åŒæ­¥çŠ¶æ€..."
    
    seconds_behind=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master:" | awk '{print $2}')
    
    if [ "$seconds_behind" = "NULL" ]; then
        echo "âŒ å¤åˆ¶å»¶è¿Ÿæ˜¾ç¤ºNULLï¼Œå¯èƒ½å­˜åœ¨é—®é¢˜"
    elif [ "$seconds_behind" -eq 0 ]; then
        echo "âœ… æ•°æ®å·²å®Œå…¨åŒæ­¥"
    else
        echo "âš ï¸ æ•°æ®å»¶è¿Ÿ $seconds_behind ç§’ï¼Œæ­£åœ¨è¿½èµ¶ä¸­"
    fi
}

# æ‰§è¡Œæ¢å¤æµç¨‹
check_network
check_current_status
restart_replication
verify_sync

echo "=== ç½‘ç»œä¸­æ–­æ¢å¤æµç¨‹å®Œæˆ ==="
```

### 11.5 é¢„é˜²æ€§ç½‘ç»œä¼˜åŒ–


**ğŸ›¡ï¸ ç½‘ç»œè¿æ¥ä¼˜åŒ–ç­–ç•¥**
```sql
-- 1. å¯ç”¨å‹ç¼©ä¼ è¾“ï¼ˆå‡å°‘å¸¦å®½éœ€æ±‚ï¼‰
STOP SLAVE;
CHANGE MASTER TO MASTER_COMPRESSION_ALGORITHMS = 'zlib';
START SLAVE;

-- 2. è°ƒæ•´å¿ƒè·³é¢‘ç‡
CHANGE MASTER TO MASTER_HEARTBEAT_PERIOD = 15;  -- 15ç§’å¿ƒè·³

-- 3. é…ç½®SSLè¿æ¥ï¼ˆå¯é€‰ï¼Œç”¨äºåŠ å¯†ä¼ è¾“ï¼‰
CHANGE MASTER TO
    MASTER_SSL = 1,
    MASTER_SSL_CA = '/path/to/ca.pem',
    MASTER_SSL_CERT = '/path/to/client-cert.pem',
    MASTER_SSL_KEY = '/path/to/client-key.pem';
```

**ğŸ“Š ç½‘ç»œç›‘æ§æŒ‡æ ‡**
```bash
# ç½‘ç»œè´¨é‡ç›‘æ§æŒ‡æ ‡æ”¶é›†è„šæœ¬
#!/bin/bash

collect_network_metrics() {
    local master_ip="ä¸»åº“IP"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # 1. ç½‘ç»œå»¶è¿Ÿ
    latency=$(ping -c 1 $master_ip | grep "time=" | awk -F'time=' '{print $2}' | awk '{print $1}' | sed 's/ms//')
    
    # 2. ä¸¢åŒ…ç‡
    packet_loss=$(ping -c 10 $master_ip | grep "packet loss" | awk '{print $6}' | sed 's/%//')
    
    # 3. å¸¦å®½æµ‹è¯•ï¼ˆéœ€è¦iperf3ï¼‰
    # bandwidth=$(iperf3 -c $master_ip -t 5 -f M | grep "receiver" | awk '{print $7}')
    
    # 4. å¤åˆ¶å»¶è¿Ÿ
    repl_delay=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master:" | awk '{print $2}')
    
    # è¾“å‡ºç›‘æ§æ•°æ®
    echo "$timestamp,$latency,$packet_loss,$repl_delay" >> /var/log/network_metrics.csv
}

# å®šæœŸæ”¶é›†æŒ‡æ ‡
collect_network_metrics
```

---

## 12. â­ï¸ å¤åˆ¶é”™è¯¯è·³è¿‡æ–¹æ³•


### 12.1 å¤åˆ¶é”™è¯¯è·³è¿‡çš„åŸºæœ¬æ¦‚å¿µ


**ğŸš« ä»€ä¹ˆæ˜¯å¤åˆ¶é”™è¯¯è·³è¿‡ï¼Ÿ**
> å¤åˆ¶é”™è¯¯è·³è¿‡å°±åƒæ˜¯åœ¨çœ‹ç”µå½±æ—¶é‡åˆ°ç”»é¢å¡é¡¿ï¼Œä½ é€‰æ‹©å¿«è¿›è·³è¿‡é—®é¢˜ç‰‡æ®µç»§ç»­è§‚çœ‹ã€‚åœ¨MySQLå¤åˆ¶ä¸­ï¼Œå½“é‡åˆ°æ— æ³•è§£å†³çš„SQLé”™è¯¯æ—¶ï¼Œå¯ä»¥é€‰æ‹©è·³è¿‡è¿™ä¸ªé”™è¯¯ç»§ç»­åç»­çš„å¤åˆ¶ã€‚ä½†è¦è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºè·³è¿‡é”™è¯¯å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚

**âš ï¸ è·³è¿‡é”™è¯¯çš„é£é™©è¯„ä¼°**
```
é”™è¯¯è·³è¿‡é£é™©ç­‰çº§ï¼š
â”œâ”€â”€ ä½é£é™©ï¼ˆå¯ä»¥è·³è¿‡ï¼‰
â”‚   â”œâ”€â”€ æµ‹è¯•æ•°æ®æ’å…¥å†²çª
â”‚   â”œâ”€â”€ ä¸´æ—¶è¡¨æ“ä½œå¤±è´¥
â”‚   â””â”€â”€ éå…³é”®ä¸šåŠ¡æ•°æ®é”™è¯¯
â”œâ”€â”€ ä¸­ç­‰é£é™©ï¼ˆè°¨æ…è·³è¿‡ï¼‰
â”‚   â”œâ”€â”€ å­—ç¬¦é›†è½¬æ¢é”™è¯¯
â”‚   â”œâ”€â”€ æ•°æ®ç±»å‹ä¸åŒ¹é…
â”‚   â””â”€â”€ ç´¢å¼•åˆ›å»ºå¤±è´¥
â”œâ”€â”€ é«˜é£é™©ï¼ˆä¸å»ºè®®è·³è¿‡ï¼‰
â”‚   â”œâ”€â”€ ä¸»é”®å†²çª
â”‚   â”œâ”€â”€ å¤–é”®çº¦æŸé”™è¯¯
â”‚   â””â”€â”€ é‡è¦ä¸šåŠ¡æ•°æ®é”™è¯¯
â””â”€â”€ æé«˜é£é™©ï¼ˆç¦æ­¢è·³è¿‡ï¼‰
    â”œâ”€â”€ ç”¨æˆ·æƒé™æ•°æ®é”™è¯¯
    â”œâ”€â”€ è´¢åŠ¡äº¤æ˜“æ•°æ®é”™è¯¯
    â””â”€â”€ ç³»ç»Ÿé…ç½®æ•°æ®é”™è¯¯
```

### 12.2 æ‰‹åŠ¨è·³è¿‡å•ä¸ªé”™è¯¯


**ğŸ”§ åŸºæœ¬è·³è¿‡æ–¹æ³•**
```sql
-- 1. æŸ¥çœ‹å½“å‰é”™è¯¯
SHOW SLAVE STATUS\G
-- é‡ç‚¹å…³æ³¨ï¼š
-- Last_SQL_Error: å…·ä½“é”™è¯¯ä¿¡æ¯
-- Last_SQL_Errno: é”™è¯¯ä»£ç 

-- 2. åœæ­¢SQLçº¿ç¨‹
STOP SLAVE SQL_THREAD;

-- 3. è·³è¿‡ä¸€ä¸ªé”™è¯¯äº‹åŠ¡
SET GLOBAL sql_slave_skip_counter = 1;

-- 4. é‡æ–°å¯åŠ¨SQLçº¿ç¨‹
START SLAVE SQL_THREAD;

-- 5. éªŒè¯æ˜¯å¦è·³è¿‡æˆåŠŸ
SHOW SLAVE STATUS\G
-- æ£€æŸ¥ Last_SQL_Error æ˜¯å¦æ¸…ç©º
```

**ğŸ“ è·³è¿‡é”™è¯¯çš„è¯¦ç»†æ­¥éª¤**
```sql
-- å®Œæ•´çš„é”™è¯¯è·³è¿‡æµç¨‹ç¤ºä¾‹

-- æ­¥éª¤1ï¼šè®°å½•å½“å‰é”™è¯¯ä¿¡æ¯ï¼ˆç”¨äºåç»­åˆ†æï¼‰
SELECT 
    NOW() as check_time,
    'Before Skip' as status,
    $$global.gtid_executed as gtid_before
INTO OUTFILE '/tmp/error_skip_log.txt';

-- æ­¥éª¤2ï¼šæŸ¥çœ‹è¯¦ç»†é”™è¯¯
SHOW SLAVE STATUS\G
-- è®°å½•ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š
-- Last_SQL_Error, Last_SQL_Errno
-- Exec_Master_Log_Pos, Relay_Master_Log_File

-- æ­¥éª¤3ï¼šæ‰§è¡Œè·³è¿‡æ“ä½œ
STOP SLAVE SQL_THREAD;
SET GLOBAL sql_slave_skip_counter = 1;
START SLAVE SQL_THREAD;

-- æ­¥éª¤4ï¼šç­‰å¾…å¹¶éªŒè¯ç»“æœ
-- ç­‰å¾…å‡ ç§’è®©å¤åˆ¶ç»§ç»­
SELECT SLEEP(5);

-- æ£€æŸ¥è·³è¿‡åçš„çŠ¶æ€
SHOW SLAVE STATUS\G

-- æ­¥éª¤5ï¼šè®°å½•è·³è¿‡åçš„çŠ¶æ€
SELECT 
    NOW() as check_time,
    'After Skip' as status,
    $$global.gtid_executed as gtid_after
INTO OUTFILE '/tmp/error_skip_log.txt';
```

### 12.3 æ‰¹é‡è·³è¿‡å¤šä¸ªé”™è¯¯


**âš¡ è·³è¿‡å¤šä¸ªè¿ç»­é”™è¯¯**
```sql
-- å½“é‡åˆ°å¤šä¸ªè¿ç»­é”™è¯¯æ—¶ï¼Œå¯ä»¥ä¸€æ¬¡è·³è¿‡å¤šä¸ª

-- æŸ¥çœ‹é”™è¯¯æ€»æ•°ï¼ˆä¼°ç®—ï¼‰
SHOW SLAVE STATUS\G
-- è§‚å¯Ÿ Exec_Master_Log_Pos å’Œ Read_Master_Log_Pos çš„å·®è·

-- è·³è¿‡å¤šä¸ªé”™è¯¯ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
STOP SLAVE SQL_THREAD;
SET GLOBAL sql_slave_skip_counter = 5;  -- è·³è¿‡5ä¸ªäº‹åŠ¡
START SLAVE SQL_THREAD;
```

**ğŸ”„ å¾ªç¯è·³è¿‡è„šæœ¬ï¼ˆè‡ªåŠ¨åŒ–å¤„ç†ï¼‰**
```bash
#!/bin/bash
# è‡ªåŠ¨è·³è¿‡å¤åˆ¶é”™è¯¯è„šæœ¬ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

skip_replication_errors() {
    local max_skips=$1
    local skip_count=0
    
    echo "å¼€å§‹è‡ªåŠ¨è·³è¿‡å¤åˆ¶é”™è¯¯ï¼Œæœ€å¤§è·³è¿‡æ¬¡æ•°: $max_skips"
    
    while [ $skip_count -lt $max_skips ]; do
        # æ£€æŸ¥æ˜¯å¦æœ‰SQLé”™è¯¯
        sql_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_SQL_Running:" | awk '{print $2}')
        last_error=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Last_SQL_Error:" | cut -d: -f2-)
        
        if [[ "$sql_running" == "No" && -n "$last_error" && "$last_error" != " " ]]; then
            skip_count=$((skip_count + 1))
            echo "[$skip_count] è·³è¿‡é”™è¯¯: $last_error"
            
            # è·³è¿‡é”™è¯¯
            mysql -e "STOP SLAVE SQL_THREAD;"
            mysql -e "SET GLOBAL sql_slave_skip_counter = 1;"
            mysql -e "START SLAVE SQL_THREAD;"
            
            # ç­‰å¾…å‡ ç§’
            sleep 5
        else
            echo "æ²¡æœ‰æ£€æµ‹åˆ°SQLé”™è¯¯ï¼Œé€€å‡ºå¾ªç¯"
            break
        fi
    done
    
    echo "è·³è¿‡æ“ä½œå®Œæˆï¼Œæ€»å…±è·³è¿‡ $skip_count ä¸ªé”™è¯¯"
}

# ä½¿ç”¨ç¤ºä¾‹ï¼šæœ€å¤šè·³è¿‡10ä¸ªé”™è¯¯
skip_replication_errors 10
```

### 12.4 é…ç½®æ–‡ä»¶çº§åˆ«çš„é”™è¯¯è·³è¿‡


**âš™ï¸ slave-skip-errorsé…ç½®**
```ini
# my.cnf ä¸­é…ç½®è‡ªåŠ¨è·³è¿‡ç‰¹å®šé”™è¯¯
[mysqld]
# è·³è¿‡ç‰¹å®šé”™è¯¯ä»£ç 
slave-skip-errors = 1062,1053,1146

# é”™è¯¯ä»£ç è¯´æ˜ï¼š
# 1062: ä¸»é”®å†²çª (Duplicate entry for key 'PRIMARY')
# 1053: æœåŠ¡å™¨å…³é—­ä¸­ (Server shutdown in progress)  
# 1146: è¡¨ä¸å­˜åœ¨ (Table doesn't exist)

# è·³è¿‡æ‰€æœ‰é”™è¯¯ï¼ˆæä¸æ¨èï¼Œä»…ç”¨äºç´§æ€¥æƒ…å†µï¼‰
# slave-skip-errors = all

# è·³è¿‡DDLé”™è¯¯ï¼ˆç›¸å¯¹å®‰å…¨ï¼‰
# slave-skip-errors = ddl_exist_errors
```

**ğŸ“Š å¸¸è§é”™è¯¯ä»£ç å‚è€ƒè¡¨**
| é”™è¯¯ä»£ç  | é”™è¯¯æè¿° | è·³è¿‡é£é™© | å»ºè®®å¤„ç† |
|----------|----------|----------|----------|
| `1062` | ä¸»é”®å†²çª | ğŸŸ¡ ä¸­ç­‰ | æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§åè·³è¿‡ |
| `1146` | è¡¨ä¸å­˜åœ¨ | ğŸŸ¢ è¾ƒä½ | ç¡®è®¤è¡¨ç»“æ„åå¯è·³è¿‡ |
| `1054` | å­—æ®µä¸å­˜åœ¨ | ğŸŸ¡ ä¸­ç­‰ | åŒæ­¥è¡¨ç»“æ„åè·³è¿‡ |
| `1452` | å¤–é”®çº¦æŸå¤±è´¥ | ğŸ”´ é«˜ | ä¿®å¤æ•°æ®å…³ç³»åè·³è¿‡ |
| `1032` | è®°å½•ä¸å­˜åœ¨ | ğŸŸ¡ ä¸­ç­‰ | ç¡®è®¤æ•°æ®çŠ¶æ€åè·³è¿‡ |
| `1213` | æ­»é”æ£€æµ‹ | ğŸŸ¢ è¾ƒä½ | å¯ä»¥è·³è¿‡ï¼Œä¼šè‡ªåŠ¨é‡è¯• |

### 12.5 GTIDæ¨¡å¼ä¸‹çš„é”™è¯¯è·³è¿‡


**ğŸ†” GTIDé”™è¯¯è·³è¿‡æ–¹æ³•**
```sql
-- GTIDæ¨¡å¼ä¸‹ä¸èƒ½ä½¿ç”¨ sql_slave_skip_counter
-- éœ€è¦ä½¿ç”¨æ³¨å…¥ç©ºäº‹åŠ¡çš„æ–¹æ³•

-- 1. æŸ¥çœ‹å‡ºé”™çš„GTID
SHOW SLAVE STATUS\G
-- æ‰¾åˆ° Last_SQL_Error ä¸­çš„ GTID ä¿¡æ¯

-- 2. åœæ­¢å¤åˆ¶
STOP SLAVE;

-- 3. æ³¨å…¥ç©ºäº‹åŠ¡è·³è¿‡é”™è¯¯
SET GTID_NEXT = '3E11FA47-71CA-11E1-9E33-C80AA9429562:100';
BEGIN; 
COMMIT;
SET GTID_NEXT = 'AUTOMATIC';

-- 4. é‡æ–°å¯åŠ¨å¤åˆ¶
START SLAVE;
```

**ğŸ”§ GTIDæ‰¹é‡è·³è¿‡è„šæœ¬**
```bash
#!/bin/bash
# GTIDæ¨¡å¼ä¸‹æ‰¹é‡è·³è¿‡é”™è¯¯è„šæœ¬

skip_gtid_errors() {
    local max_skips=$1
    local skip_count=0
    
    while [ $skip_count -lt $max_skips ]; do
        # è·å–é”™è¯¯çš„GTID
        error_gtid=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Last_SQL_Error:" | grep -o '[0-9a-f\-]*:[0-9]*')
        
        if [ -n "$error_gtid" ]; then
            skip_count=$((skip_count + 1))
            echo "[$skip_count] è·³è¿‡GTID: $error_gtid"
            
            # æ³¨å…¥ç©ºäº‹åŠ¡
            mysql -e "
                STOP SLAVE;
                SET GTID_NEXT = '$error_gtid';
                BEGIN; COMMIT;
                SET GTID_NEXT = 'AUTOMATIC';
                START SLAVE;
            "
            
            sleep 5
        else
            echo "æ²¡æœ‰æ£€æµ‹åˆ°GTIDé”™è¯¯ï¼Œé€€å‡º"
            break
        fi
    done
    
    echo "GTIDè·³è¿‡å®Œæˆï¼Œå…±å¤„ç† $skip_count ä¸ªé”™è¯¯"
}

# æ‰§è¡Œè·³è¿‡
skip_gtid_errors 5
```

### 12.6 é”™è¯¯è·³è¿‡çš„æœ€ä½³å®è·µ


**ğŸ’¡ è·³è¿‡é”™è¯¯çš„å†³ç­–æµç¨‹**
```
é”™è¯¯è·³è¿‡å†³ç­–æ ‘ï¼š
é‡åˆ°å¤åˆ¶é”™è¯¯
    â†“
æ˜¯å¦ä¸ºå…³é”®ä¸šåŠ¡æ•°æ®ï¼Ÿ
    â”œâ”€â”€ æ˜¯ â†’ ä¸è·³è¿‡ï¼Œæ‰‹åŠ¨ä¿®å¤æ•°æ®
    â””â”€â”€ å¦ â†“
æ˜¯å¦å½±å“æ•°æ®ä¸€è‡´æ€§ï¼Ÿ
    â”œâ”€â”€ æ˜¯ â†’ è¯„ä¼°å½±å“èŒƒå›´ï¼Œè°¨æ…å¤„ç†
    â””â”€â”€ å¦ â†“
æ˜¯å¦ä¸ºå·²çŸ¥çš„å®‰å…¨é”™è¯¯ï¼Ÿ
    â”œâ”€â”€ æ˜¯ â†’ å¯ä»¥è·³è¿‡
    â””â”€â”€ å¦ â†“
æµ‹è¯•ç¯å¢ƒéªŒè¯è·³è¿‡æ•ˆæœ
    â†“
ç”Ÿäº§ç¯å¢ƒè°¨æ…è·³è¿‡
    â†“
è·³è¿‡åéªŒè¯æ•°æ®ä¸€è‡´æ€§
```

**ğŸ“ é”™è¯¯è·³è¿‡è®°å½•æ¨¡æ¿**
```bash
# åˆ›å»ºé”™è¯¯è·³è¿‡æ—¥å¿—è®°å½•
create_skip_log() {
    local error_desc="$1"
    local skip_reason="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    cat >> /var/log/mysql_skip_errors.log << EOF
=== å¤åˆ¶é”™è¯¯è·³è¿‡è®°å½• ===
æ—¶é—´: $timestamp
é”™è¯¯æè¿°: $error_desc
è·³è¿‡åŸå› : $skip_reason
æ“ä½œäººå‘˜: $(whoami)
è·³è¿‡å‰GTID: $(mysql -e "SELECT $$global.gtid_executed;" -s)
--
è·³è¿‡åGTID: å¾…æ›´æ–°
æ•°æ®éªŒè¯ç»“æœ: å¾…éªŒè¯
é£é™©è¯„ä¼°: å¾…è¯„ä¼°
========================

EOF
}

# ä½¿ç”¨ç¤ºä¾‹
create_skip_log "Duplicate entry for key PRIMARY" "æµ‹è¯•æ•°æ®å†²çªï¼Œä¸å½±å“ä¸šåŠ¡"
```

---

## 13. ğŸ“Š å¤åˆ¶çŠ¶æ€ç›‘æ§


### 13.1 å¤åˆ¶ç›‘æ§çš„é‡è¦æ€§


**ğŸ‘ï¸ ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§å¤åˆ¶çŠ¶æ€ï¼Ÿ**
> å¤åˆ¶ç›‘æ§å°±åƒæ˜¯åŒ»ç”Ÿå®šæœŸç»™ç—…äººåšä½“æ£€ã€‚é€šè¿‡æŒç»­ç›‘æ§å„é¡¹å¥åº·æŒ‡æ ‡ï¼Œå¯ä»¥åŠæ—¶å‘ç°é—®é¢˜ã€é¢„é˜²æ•…éšœã€ä¼˜åŒ–æ€§èƒ½ã€‚æ²¡æœ‰ç›‘æ§çš„å¤åˆ¶ç¯å¢ƒå°±åƒæ˜¯"ç›²é£"ï¼Œé—®é¢˜å‘ç”Ÿäº†å¯èƒ½å¾ˆä¹…æ‰èƒ½å‘ç°ã€‚

**ğŸ“Š ç›‘æ§ç»´åº¦åˆ†æ**
```
å¤åˆ¶ç›‘æ§ç»´åº¦ï¼š
â”œâ”€â”€ åŸºç¡€çŠ¶æ€ç›‘æ§ (40%)
â”‚   â”œâ”€â”€ IO/SQLçº¿ç¨‹çŠ¶æ€
â”‚   â”œâ”€â”€ å¤åˆ¶å»¶è¿Ÿæ—¶é—´
â”‚   â””â”€â”€ é”™è¯¯ä¿¡æ¯æ”¶é›†
â”œâ”€â”€ æ€§èƒ½ç›‘æ§ (30%)
â”‚   â”œâ”€â”€ ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½
â”‚   â”œâ”€â”€ å¤åˆ¶ååé‡
â”‚   â””â”€â”€ èµ„æºä½¿ç”¨æƒ…å†µ
â”œâ”€â”€ æ•°æ®ä¸€è‡´æ€§ç›‘æ§ (20%)
â”‚   â”œâ”€â”€ æ•°æ®é‡å¯¹æ¯”
â”‚   â”œâ”€â”€ æ ¡éªŒå’ŒéªŒè¯
â”‚   â””â”€â”€ å…³é”®è¡¨åŒæ­¥çŠ¶æ€
â””â”€â”€ å‘Šè­¦å’ŒæŠ¥å‘Š (10%)
    â”œâ”€â”€ å®æ—¶å‘Šè­¦é€šçŸ¥
    â”œâ”€â”€ è¶‹åŠ¿åˆ†ææŠ¥å‘Š
    â””â”€â”€ æ•…éšœè‡ªåŠ¨å¤„ç†
```

### 13.2 åŸºç¡€çŠ¶æ€ç›‘æ§


**ğŸ” æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**
```sql
-- åŸºç¡€å¤åˆ¶çŠ¶æ€æŸ¥è¯¢
SELECT 
    -- åŸºç¡€çŠ¶æ€
    IF(Slave_IO_Running='Yes', 'âœ… æ­£å¸¸', 'âŒ å¼‚å¸¸') AS IOçº¿ç¨‹çŠ¶æ€,
    IF(Slave_SQL_Running='Yes', 'âœ… æ­£å¸¸', 'âŒ å¼‚å¸¸') AS SQLçº¿ç¨‹çŠ¶æ€,
    
    -- å»¶è¿Ÿç›‘æ§
    CASE 
        WHEN Seconds_Behind_Master IS NULL THEN 'âŒ å¤åˆ¶åœæ­¢'
        WHEN Seconds_Behind_Master = 0 THEN 'âœ… å®æ—¶åŒæ­¥'
        WHEN Seconds_Behind_Master <= 10 THEN 'ğŸŸ¡ è½»å¾®å»¶è¿Ÿ'
        WHEN Seconds_Behind_Master <= 60 THEN 'ğŸŸ  ä¸­ç­‰å»¶è¿Ÿ'
        ELSE 'ğŸ”´ ä¸¥é‡å»¶è¿Ÿ'
    END AS å»¶è¿ŸçŠ¶æ€,
    Seconds_Behind_Master AS å»¶è¿Ÿç§’æ•°,
    
    -- ä½ç½®ä¿¡æ¯
    Master_Log_File AS ä¸»åº“æ–‡ä»¶,
    Read_Master_Log_Pos AS è¯»å–ä½ç½®,
    Exec_Master_Log_Pos AS æ‰§è¡Œä½ç½®,
    
    -- é”™è¯¯ä¿¡æ¯
    Last_IO_Error AS IOé”™è¯¯,
    Last_SQL_Error AS SQLé”™è¯¯
    
FROM (SELECT * FROM information_schema.replica_host_status) AS rs\G
```

**ğŸ“Š ç›‘æ§ä»ªè¡¨æ¿è„šæœ¬**
```bash
#!/bin/bash
# MySQLå¤åˆ¶çŠ¶æ€ç›‘æ§ä»ªè¡¨æ¿

show_replication_dashboard() {
    clear
    echo "=================================================="
    echo "           MySQLå¤åˆ¶çŠ¶æ€ç›‘æ§ä»ªè¡¨æ¿"
    echo "              $(date '+%Y-%m-%d %H:%M:%S')"
    echo "=================================================="
    echo ""
    
    # è·å–åŸºç¡€çŠ¶æ€
    io_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_IO_Running:" | awk '{print $2}')
    sql_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_SQL_Running:" | awk '{print $2}')
    delay=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master:" | awk '{print $2}')
    
    # çŠ¶æ€æ˜¾ç¤º
    echo "ğŸ”„ å¤åˆ¶çº¿ç¨‹çŠ¶æ€ï¼š"
    echo "   IOçº¿ç¨‹: $([ "$io_running" = "Yes" ] && echo "âœ… è¿è¡Œä¸­" || echo "âŒ å·²åœæ­¢")"
    echo "   SQLçº¿ç¨‹: $([ "$sql_running" = "Yes" ] && echo "âœ… è¿è¡Œä¸­" || echo "âŒ å·²åœæ­¢")"
    echo ""
    
    # å»¶è¿ŸçŠ¶æ€
    echo "â±ï¸  å¤åˆ¶å»¶è¿ŸçŠ¶æ€ï¼š"
    if [ "$delay" = "NULL" ]; then
        echo "   çŠ¶æ€: âŒ å¤åˆ¶å·²åœæ­¢"
    elif [ "$delay" -eq 0 ]; then
        echo "   çŠ¶æ€: âœ… å®æ—¶åŒæ­¥ (0ç§’)"
    elif [ "$delay" -le 10 ]; then
        echo "   çŠ¶æ€: ğŸŸ¡ è½»å¾®å»¶è¿Ÿ (${delay}ç§’)"
    elif [ "$delay" -le 60 ]; then
        echo "   çŠ¶æ€: ğŸŸ  ä¸­ç­‰å»¶è¿Ÿ (${delay}ç§’)"
    else
        echo "   çŠ¶æ€: ğŸ”´ ä¸¥é‡å»¶è¿Ÿ (${delay}ç§’)"
    fi
    echo ""
    
    # ç½‘ç»œçŠ¶æ€
    echo "ğŸŒ ç½‘ç»œè¿æ¥çŠ¶æ€ï¼š"
    master_ip=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Master_Host:" | awk '{print $2}')
    if ping -c 1 $master_ip > /dev/null 2>&1; then
        ping_time=$(ping -c 1 $master_ip | grep "time=" | awk -F'time=' '{print $2}' | awk '{print $1}')
        echo "   è¿æ¥: âœ… æ­£å¸¸ (å»¶è¿Ÿ: ${ping_time})"
    else
        echo "   è¿æ¥: âŒ ç½‘ç»œä¸é€š"
    fi
    echo ""
    
    # é”™è¯¯ä¿¡æ¯
    io_error=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Last_IO_Error:" | cut -d: -f2-)
    sql_error=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Last_SQL_Error:" | cut -d: -f2-)
    
    echo "âš ï¸  é”™è¯¯ä¿¡æ¯ï¼š"
    if [ -n "$io_error" ] && [ "$io_error" != " " ]; then
        echo "   IOé”™è¯¯: $io_error"
    else
        echo "   IOé”™è¯¯: âœ… æ— "
    fi
    
    if [ -n "$sql_error" ] && [ "$sql_error" != " " ]; then
        echo "   SQLé”™è¯¯: $sql_error"
    else
        echo "   SQLé”™è¯¯: âœ… æ— "
    fi
    echo ""
    
    echo "=================================================="
    echo "æŒ‰ Ctrl+C é€€å‡ºç›‘æ§"
    echo "=================================================="
}

# å¾ªç¯æ˜¾ç¤ºä»ªè¡¨æ¿
while true; do
    show_replication_dashboard
    sleep 10
done
```

### 13.3 æ€§èƒ½ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ å¤åˆ¶æ€§èƒ½ç›‘æ§æŸ¥è¯¢**
```sql
-- å¤åˆ¶æ€§èƒ½ç»Ÿè®¡æŸ¥è¯¢
SELECT 
    -- äº‹åŠ¡ç»Ÿè®¡
    (SELECT COUNT(*) FROM information_schema.processlist WHERE State LIKE '%Slave%') AS æ´»è·ƒå¤åˆ¶çº¿ç¨‹,
    
    -- å»¶è¿Ÿç»Ÿè®¡
    (SELECT 
        CASE 
            WHEN AVG(Seconds_Behind_Master) IS NULL THEN 'å¤åˆ¶åœæ­¢'
            ELSE CONCAT(ROUND(AVG(Seconds_Behind_Master), 2), 'ç§’')
        END
     FROM information_schema.replica_host_status) AS å¹³å‡å»¶è¿Ÿ,
    
    -- Binlogæ–‡ä»¶ç»Ÿè®¡
    (SELECT COUNT(*) FROM information_schema.BINARY_LOG_FILES) AS Binlogæ–‡ä»¶æ•°,
    
    -- å¤åˆ¶è¿‡æ»¤ç»Ÿè®¡
    (SELECT 
        CONCAT(
            IF(LENGTH(Replicate_Do_DB) > 0, CONCAT('åŒ…å«:', Replicate_Do_DB, ' '), ''),
            IF(LENGTH(Replicate_Ignore_DB) > 0, CONCAT('æ’é™¤:', Replicate_Ignore_DB), '')
        )
     FROM information_schema.replica_host_status) AS è¿‡æ»¤è§„åˆ™;
```

**ğŸ”§ æ€§èƒ½æŒ‡æ ‡æ”¶é›†è„šæœ¬**
```bash
#!/bin/bash
# MySQLå¤åˆ¶æ€§èƒ½æŒ‡æ ‡æ”¶é›†

collect_performance_metrics() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local metrics_file="/var/log/mysql_replication_metrics.csv"
    
    # åˆ›å»ºCSVå¤´éƒ¨ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼‰
    if [ ! -f "$metrics_file" ]; then
        echo "timestamp,io_running,sql_running,delay_seconds,relay_log_space,master_log_pos" > $metrics_file
    fi
    
    # æ”¶é›†æŒ‡æ ‡
    io_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_IO_Running:" | awk '{print $2}')
    sql_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_SQL_Running:" | awk '{print $2}')
    delay=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master:" | awk '{print $2}')
    relay_space=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Relay_Log_Space:" | awk '{print $2}')
    master_pos=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Read_Master_Log_Pos:" | awk '{print $2}')
    
    # å†™å…¥æ•°æ®
    echo "$timestamp,$io_running,$sql_running,$delay,$relay_space,$master_pos" >> $metrics_file
    
    # ä¿ç•™æœ€è¿‘30å¤©çš„æ•°æ®
    find /var/log -name "mysql_replication_metrics.csv" -mtime +30 -delete
}

# ä¸»åº“æ€§èƒ½æŒ‡æ ‡æ”¶é›†
collect_master_metrics() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # è·å–ä¸»åº“çŠ¶æ€
    master_file=$(mysql -e "SHOW MASTER STATUS;" | grep -v File | awk '{print $1}')
    master_pos=$(mysql -e "SHOW MASTER STATUS;" | grep -v File | awk '{print $2}')
    
    # è·å–binlogç”Ÿæˆé€Ÿåº¦
    current_pos=$(mysql -e "SHOW MASTER STATUS;" | grep -v File | awk '{print $2}')
    sleep 60
    next_pos=$(mysql -e "SHOW MASTER STATUS;" | grep -v File | awk '{print $2}')
    binlog_speed=$((next_pos - current_pos))
    
    echo "$timestamp: Binlogç”Ÿæˆé€Ÿåº¦: $binlog_speed å­—èŠ‚/åˆ†é’Ÿ"
}

# å®šæœŸæ”¶é›†æŒ‡æ ‡
collect_performance_metrics
```

### 13.4 è‡ªåŠ¨åŒ–å‘Šè­¦ç³»ç»Ÿ


**ğŸš¨ å‘Šè­¦è§„åˆ™é…ç½®**
```bash
#!/bin/bash
# MySQLå¤åˆ¶å‘Šè­¦ç³»ç»Ÿ

# å‘Šè­¦é…ç½®
ALERT_EMAIL="admin@company.com"
ALERT_PHONE="13800138000"
DELAY_THRESHOLD=300        # å»¶è¿Ÿè¶…è¿‡5åˆ†é’Ÿå‘Šè­¦
ERROR_CHECK_INTERVAL=60    # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡

# å‘é€é‚®ä»¶å‘Šè­¦
send_email_alert() {
    local subject="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    cat << EOF | mail -s "$subject" $ALERT_EMAIL
MySQLå¤åˆ¶å‘Šè­¦é€šçŸ¥

æ—¶é—´: $timestamp
æœåŠ¡å™¨: $(hostname)
å‘Šè­¦å†…å®¹: $message

è¯·åŠæ—¶å¤„ç†ï¼

--
è‡ªåŠ¨ç›‘æ§ç³»ç»Ÿ
EOF
}

# å‘é€çŸ­ä¿¡å‘Šè­¦ï¼ˆéœ€è¦çŸ­ä¿¡æ¥å£ï¼‰
send_sms_alert() {
    local message="$1"
    # curl -X POST "çŸ­ä¿¡æ¥å£URL" -d "phone=$ALERT_PHONE&message=$message"
    echo "çŸ­ä¿¡å‘Šè­¦: $message"
}

# å»¶è¿Ÿå‘Šè­¦æ£€æŸ¥
check_delay_alert() {
    local delay=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master:" | awk '{print $2}')
    
    if [ "$delay" = "NULL" ]; then
        send_email_alert "MySQLå¤åˆ¶åœæ­¢å‘Šè­¦" "å¤åˆ¶å·²å®Œå…¨åœæ­¢ï¼Œè¯·ç«‹å³æ£€æŸ¥"
        send_sms_alert "MySQLå¤åˆ¶åœæ­¢ï¼Œè¯·ç«‹å³å¤„ç†"
        return 1
    elif [ "$delay" -gt $DELAY_THRESHOLD ]; then
        send_email_alert "MySQLå¤åˆ¶å»¶è¿Ÿå‘Šè­¦" "å¤åˆ¶å»¶è¿Ÿå·²è¾¾åˆ° $delay ç§’ï¼Œè¶…è¿‡é˜ˆå€¼ $DELAY_THRESHOLD ç§’"
        return 1
    fi
    
    return 0
}

# é”™è¯¯çŠ¶æ€å‘Šè­¦æ£€æŸ¥
check_error_alert() {
    local io_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_IO_Running:" | awk '{print $2}')
    local sql_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_SQL_Running:" | awk '{print $2}')
    local io_error=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Last_IO_Error:" | cut -d: -f2-)
    local sql_error=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Last_SQL_Error:" | cut -d: -f2-)
    
    # IOçº¿ç¨‹çŠ¶æ€æ£€æŸ¥
    if [ "$io_running" != "Yes" ]; then
        send_email_alert "MySQL IOçº¿ç¨‹åœæ­¢å‘Šè­¦" "IOçº¿ç¨‹çŠ¶æ€: $io_running, é”™è¯¯ä¿¡æ¯: $io_error"
        return 1
    fi
    
    # SQLçº¿ç¨‹çŠ¶æ€æ£€æŸ¥
    if [ "$sql_running" != "Yes" ]; then
        send_email_alert "MySQL SQLçº¿ç¨‹åœæ­¢å‘Šè­¦" "SQLçº¿ç¨‹çŠ¶æ€: $sql_running, é”™è¯¯ä¿¡æ¯: $sql_error"
        return 1
    fi
    
    return 0
}

# ç½‘ç»œè¿æ¥å‘Šè­¦æ£€æŸ¥
check_network_alert() {
    local master_ip=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Master_Host:" | awk '{print $2}')
    
    if ! ping -c 3 $master_ip > /dev/null 2>&1; then
        send_email_alert "MySQLä¸»åº“ç½‘ç»œè¿æ¥å‘Šè­¦" "æ— æ³•pingé€šä¸»åº“ $master_ipï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"
        return 1
    fi
    
    if ! timeout 5 bash -c "</dev/tcp/$master_ip/3306" > /dev/null 2>&1; then
        send_email_alert "MySQLä¸»åº“ç«¯å£è¿æ¥å‘Šè­¦" "æ— æ³•è¿æ¥ä¸»åº“ $master_ip:3306ï¼Œè¯·æ£€æŸ¥ä¸»åº“çŠ¶æ€"
        return 1
    fi
    
    return 0
}

# ä¸»ç›‘æ§å¾ªç¯
main_monitoring_loop() {
    while true; do
        echo "$(date): æ‰§è¡Œå¤åˆ¶çŠ¶æ€æ£€æŸ¥..."
        
        # æ‰§è¡Œå„é¡¹æ£€æŸ¥
        check_delay_alert
        check_error_alert
        check_network_alert
        
        echo "$(date): æ£€æŸ¥å®Œæˆï¼Œç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥..."
        sleep $ERROR_CHECK_INTERVAL
    done
}

# å¯åŠ¨ç›‘æ§
echo "å¯åŠ¨MySQLå¤åˆ¶ç›‘æ§ç³»ç»Ÿ..."
main_monitoring_loop
```

### 13.5 ç›‘æ§æ•°æ®å¯è§†åŒ–


**ğŸ“Š ç›‘æ§æŠ¥è¡¨ç”Ÿæˆ**
```bash
#!/bin/bash
# ç”Ÿæˆå¤åˆ¶çŠ¶æ€æŠ¥è¡¨

generate_daily_report() {
    local date=$(date '+%Y-%m-%d')
    local report_file="/var/reports/mysql_replication_${date}.html"
    
    # åˆ›å»ºHTMLæŠ¥è¡¨
    cat > $report_file << EOF
<!DOCTYPE html>
<html>
<head>
    <title>MySQLå¤åˆ¶çŠ¶æ€æ—¥æŠ¥ - $date</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .status-ok { color: green; font-weight: bold; }
        .status-error { color: red; font-weight: bold; }
        .status-warning { color: orange; font-weight: bold; }
    </style>
</head>
<body>
    <h1>MySQLå¤åˆ¶çŠ¶æ€æ—¥æŠ¥</h1>
    <p>æŠ¥è¡¨æ—¥æœŸ: $date</p>
    <p>ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')</p>
    
    <h2>å½“å‰çŠ¶æ€æ¦‚è§ˆ</h2>
    <table>
        <tr><th>ç›‘æ§é¡¹</th><th>çŠ¶æ€</th><th>è¯¦ç»†ä¿¡æ¯</th></tr>
EOF

    # è·å–å½“å‰çŠ¶æ€æ•°æ®
    io_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_IO_Running:" | awk '{print $2}')
    sql_running=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Slave_SQL_Running:" | awk '{print $2}')
    delay=$(mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master:" | awk '{print $2}')
    
    # æ·»åŠ çŠ¶æ€è¡Œ
    echo "        <tr><td>IOçº¿ç¨‹</td><td class=\"$([ "$io_running" = "Yes" ] && echo "status-ok" || echo "status-error")\">$io_running</td><td>$([ "$io_running" = "Yes" ] && echo "æ­£å¸¸è¿è¡Œ" || echo "å·²åœæ­¢")</td></tr>" >> $report_file
    
    echo "        <tr><td>SQLçº¿ç¨‹</td><td class=\"$([ "$sql_running" = "Yes" ] && echo "status-ok" || echo "status-error")\">$sql_running</td><td>$([ "$sql_running" = "Yes" ] && echo "æ­£å¸¸è¿è¡Œ" || echo "å·²åœæ­¢")</td></tr>" >> $report_file
    
    if [ "$delay" = "NULL" ]; then
        echo "        <tr><td>å¤åˆ¶å»¶è¿Ÿ</td><td class=\"status-error\">NULL</td><td>å¤åˆ¶å·²åœæ­¢</td></tr>" >> $report_file
    elif [ "$delay" -eq 0 ]; then
        echo "        <tr><td>å¤åˆ¶å»¶è¿Ÿ</td><td class=\"status-ok\">$delay ç§’</td><td>å®æ—¶åŒæ­¥</td></tr>" >> $report_file
    elif [ "$delay" -le 60 ]; then
        echo "        <tr><td>å¤åˆ¶å»¶è¿Ÿ</td><td class=\"status-warning\">$delay ç§’</td><td>è½»å¾®å»¶è¿Ÿ</td></tr>" >> $report_file
    else
        echo "        <tr><td>å¤åˆ¶å»¶è¿Ÿ</td><td class=\"status-error\">$delay ç§’</td><td>ä¸¥é‡å»¶è¿Ÿ</td></tr>" >> $report_file
    fi
    
    # ç»“æŸHTML
    cat >> $report_file << EOF
    </table>
    
    <h2>24å°æ—¶è¶‹åŠ¿å›¾</h2>
    <p><em>æ³¨ï¼šéœ€è¦é…åˆå›¾è¡¨ç”Ÿæˆå·¥å…·æ˜¾ç¤ºå»¶è¿Ÿè¶‹åŠ¿</em></p>
    
    <h2>ä»Šæ—¥å‘Šè­¦è®°å½•</h2>
    <pre>$(grep "$(date '+%Y-%m-%d')" /var/log/mysql_alerts.log 2>/dev/null || echo "ä»Šæ—¥æ— å‘Šè­¦è®°å½•")</pre>
    
    <footer>
        <p>æŠ¥è¡¨ç”Ÿæˆæ—¶é—´: $(date)</p>
        <p>ç›‘æ§ç³»ç»Ÿç‰ˆæœ¬: v1.0</p>
    </footer>
</body>
</html>
EOF

    echo "æ—¥æŠ¥å·²ç”Ÿæˆ: $report_file"
}

# æ€§èƒ½è¶‹åŠ¿åˆ†æ
analyze_performance_trend() {
    local days=${1:-7}  # é»˜è®¤åˆ†ææœ€è¿‘7å¤©
    
    echo "=== å¤åˆ¶æ€§èƒ½è¶‹åŠ¿åˆ†æï¼ˆæœ€è¿‘${days}å¤©ï¼‰ ==="
    
    # åˆ†æå¹³å‡å»¶è¿Ÿè¶‹åŠ¿
    echo "ğŸ“Š å¹³å‡å»¶è¿Ÿè¶‹åŠ¿ï¼š"
    for i in $(seq 0 $((days-1))); do
        local check_date=$(date -d "$i days ago" '+%Y-%m-%d')
        local avg_delay=$(grep "$check_date" /var/log/mysql_replication_metrics.csv 2>/dev/null | awk -F',' '{sum+=$4; count++} END {if(count>0) print sum/count; else print "N/A"}')
        echo "  $check_date: $avg_delay ç§’"
    done
    
    echo ""
    echo "ğŸ“ˆ å»ºè®®ä¼˜åŒ–æªæ–½ï¼š"
    echo "  - å¦‚æœå»¶è¿ŸæŒç»­å¢é•¿ï¼Œè€ƒè™‘ä¼˜åŒ–ç½‘ç»œæˆ–ç¡¬ä»¶"
    echo "  - å¦‚æœå»¶è¿Ÿæ³¢åŠ¨è¾ƒå¤§ï¼Œæ£€æŸ¥ç½‘ç»œç¨³å®šæ€§"
    echo "  - å¦‚æœå»¶è¿Ÿä¸º0ä½†å¶æœ‰æ³¢åŠ¨ï¼Œå±äºæ­£å¸¸ç°è±¡"
}

# ç”ŸæˆæŠ¥è¡¨å’Œåˆ†æ
generate_daily_report
analyze_performance_trend 7
```

---

## 14. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 14.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


**ğŸ¯ ä¸»ä»å¤åˆ¶æ•…éšœå¤„ç†æ ¸å¿ƒçŸ¥è¯†ç‚¹**
```
ğŸ”¸ å¤åˆ¶åŸºç¡€åŸç†ï¼šbinlog â†’ relay log â†’ SQLé‡æ”¾çš„ä¸‰é˜¶æ®µæµç¨‹
ğŸ”¸ åŒçº¿ç¨‹æœºåˆ¶ï¼šIOçº¿ç¨‹è´Ÿè´£æ‹‰å–ï¼ŒSQLçº¿ç¨‹è´Ÿè´£æ‰§è¡Œï¼Œç›¸äº’ç‹¬ç«‹
ğŸ”¸ çŠ¶æ€ç›‘æ§è¦ç‚¹ï¼šSlave_IO_Running, Slave_SQL_Running, Seconds_Behind_Master
ğŸ”¸ ä½ç‚¹ç®¡ç†ï¼šMaster_Log_File + Master_Log_Pos ç¡®å®šå¤åˆ¶è¿›åº¦
ğŸ”¸ æƒé™é…ç½®ï¼šREPLICATION SLAVEæƒé™æ˜¯å¤åˆ¶çš„åŸºç¡€è¦æ±‚
ğŸ”¸ ç½‘ç»œä¾èµ–æ€§ï¼šå¤åˆ¶ä¸¥é‡ä¾èµ–ç½‘ç»œç¨³å®šæ€§å’Œè¿æ¥è´¨é‡
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šè·³è¿‡é”™è¯¯å¯èƒ½å¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´
```

### 14.2 æ•…éšœè¯Šæ–­æ ¸å¿ƒæµç¨‹


**ğŸ” æ ‡å‡†æ•…éšœè¯Šæ–­æ­¥éª¤**
```
æ•…éšœè¯Šæ–­æ ‡å‡†æµç¨‹ï¼š
1. æ£€æŸ¥å¤åˆ¶çŠ¶æ€ â†’ SHOW SLAVE STATUS\G
2. åˆ¤æ–­æ•…éšœç±»å‹ â†’ IOå¼‚å¸¸ vs SQLå¼‚å¸¸ vs ç½‘ç»œé—®é¢˜
3. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ â†’ Last_IO_Error, Last_SQL_Error
4. åˆ†ææ ¹æœ¬åŸå›  â†’ æƒé™ã€ç½‘ç»œã€æ•°æ®å†²çªã€é…ç½®é—®é¢˜
5. åˆ¶å®šä¿®å¤æ–¹æ¡ˆ â†’ æ ¹æ®æ•…éšœç±»å‹é€‰æ‹©å¯¹åº”æ–¹æ³•
6. æ‰§è¡Œä¿®å¤æ“ä½œ â†’ è°¨æ…æ“ä½œï¼Œè®°å½•å˜æ›´
7. éªŒè¯ä¿®å¤æ•ˆæœ â†’ ç¡®è®¤å¤åˆ¶æ¢å¤ä¸”æ•°æ®ä¸€è‡´
8. é¢„é˜²æªæ–½æ”¹è¿› â†’ ä¼˜åŒ–é…ç½®ï¼Œå®Œå–„ç›‘æ§
```

### 14.3 å…³é”®æ•…éšœå¤„ç†æ–¹æ³•


**ğŸ› ï¸ å„ç±»æ•…éšœçš„å¿«é€Ÿè§£å†³æ–¹æ¡ˆ**

| æ•…éšœç±»å‹ | **å¿«é€Ÿè¯Šæ–­** | **å¸¸è§åŸå› ** | **è§£å†³æ–¹æ³•** | **é¢„é˜²æªæ–½** |
|----------|-------------|-------------|-------------|-------------|
| **IOçº¿ç¨‹å¼‚å¸¸** | `Slave_IO_Running: No` | ç½‘ç»œä¸­æ–­ã€æƒé™é—®é¢˜ã€binlogä¸¢å¤± | æ£€æŸ¥ç½‘ç»œâ†’ä¿®å¤æƒé™â†’é‡æ–°å®šä½ | ç½‘ç»œç›‘æ§ã€æƒé™å¤‡ä»½ |
| **SQLçº¿ç¨‹å¼‚å¸¸** | `Slave_SQL_Running: No` | æ•°æ®å†²çªã€è¡¨ç»“æ„å·®å¼‚ã€SQLé”™è¯¯ | è·³è¿‡é”™è¯¯â†’ä¿®å¤æ•°æ®â†’åŒæ­¥ç»“æ„ | æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ |
| **å¤åˆ¶å»¶è¿Ÿ** | `Seconds_Behind_Master > é˜ˆå€¼` | ç½‘ç»œæ…¢ã€æ€§èƒ½å·®ã€å•çº¿ç¨‹é™åˆ¶ | ç½‘ç»œä¼˜åŒ–â†’å¹¶è¡Œå¤åˆ¶â†’æ€§èƒ½è°ƒä¼˜ | æ€§èƒ½ç›‘æ§ã€å®¹é‡è§„åˆ’ |
| **GTIDæ•…éšœ** | GTIDç›¸å…³é”™è¯¯ | GTIDå†²çªã€æ¨¡å¼åˆ‡æ¢é—®é¢˜ | æ³¨å…¥ç©ºäº‹åŠ¡â†’é‡æ–°é…ç½® | æ ‡å‡†åŒ–GTIDä½¿ç”¨ |
| **æƒé™é—®é¢˜** | è®¤è¯å¤±è´¥ | ç”¨æˆ·ä¸å­˜åœ¨ã€å¯†ç é”™è¯¯ã€æƒé™ä¸è¶³ | é‡å»ºç”¨æˆ·â†’æˆæƒâ†’æ›´æ–°é…ç½® | æƒé™ç®¡ç†è§„èŒƒ |

### 14.4 æœ€ä½³å®è·µæ€»ç»“


**ğŸ’¡ MySQLä¸»ä»å¤åˆ¶è¿ç»´æœ€ä½³å®è·µ**

**ğŸ”¹ é…ç½®å±‚é¢çš„æœ€ä½³å®è·µ**
```
é…ç½®ä¼˜åŒ–å»ºè®®ï¼š
âœ… å¯ç”¨GTIDå¤åˆ¶ï¼ˆæ–°ç¯å¢ƒæ¨èï¼‰
âœ… é…ç½®åˆç†çš„é‡è¿å‚æ•°ï¼ˆmaster_connect_retry, master_retry_countï¼‰
âœ… è®¾ç½®é€‚å½“çš„å¿ƒè·³é—´éš”ï¼ˆmaster_heartbeat_periodï¼‰
âœ… å¯ç”¨å¹¶è¡Œå¤åˆ¶ï¼ˆslave_parallel_workersï¼‰
âœ… é…ç½®SSLè¿æ¥ï¼ˆå®‰å…¨è¦æ±‚é«˜çš„ç¯å¢ƒï¼‰
âœ… è®¾ç½®åˆç†çš„ç½‘ç»œè¶…æ—¶ï¼ˆslave_net_timeoutï¼‰
âœ… ä½¿ç”¨ä¸“ç”¨çš„å¤åˆ¶ç”¨æˆ·ï¼ˆæœ€å°æƒé™åŸåˆ™ï¼‰
```

**ğŸ”¹ ç›‘æ§å±‚é¢çš„æœ€ä½³å®è·µ**
```
ç›‘æ§ä½“ç³»å»ºè®¾ï¼š
ğŸ“Š å®æ—¶çŠ¶æ€ç›‘æ§ï¼šIO/SQLçº¿ç¨‹çŠ¶æ€ã€å¤åˆ¶å»¶è¿Ÿ
ğŸ“Š æ€§èƒ½æŒ‡æ ‡ç›‘æ§ï¼šç½‘ç»œå»¶è¿Ÿã€ååé‡ã€èµ„æºä½¿ç”¨
ğŸ“Š å‘Šè­¦æœºåˆ¶ï¼šå»¶è¿Ÿé˜ˆå€¼ã€é”™è¯¯çŠ¶æ€ã€ç½‘ç»œä¸­æ–­
ğŸ“Š æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ï¼šå®šæœŸæ ¡éªŒã€pt-table-checksum
ğŸ“Š è¶‹åŠ¿åˆ†æï¼šå†å²æ•°æ®åˆ†æã€å®¹é‡è§„åˆ’
ğŸ“Š è‡ªåŠ¨åŒ–å¤„ç†ï¼šç®€å•æ•…éšœè‡ªåŠ¨æ¢å¤
```

**ğŸ”¹ æ•…éšœå¤„ç†çš„æœ€ä½³å®è·µ**
```
æ•…éšœå¤„ç†åŸåˆ™ï¼š
ğŸ¯ å¿«é€Ÿå“åº”ï¼šå»ºç«‹å‘Šè­¦æœºåˆ¶ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
ğŸ¯ å‡†ç¡®è¯Šæ–­ï¼šç³»ç»ŸåŒ–çš„æ•…éšœåˆ†ææµç¨‹
ğŸ¯ è°¨æ…æ“ä½œï¼šé‡è¦æ“ä½œå‰å¤‡ä»½çŠ¶æ€ä¿¡æ¯
ğŸ¯ å®Œæ•´è®°å½•ï¼šè¯¦ç»†è®°å½•æ•…éšœç°è±¡å’Œå¤„ç†è¿‡ç¨‹
ğŸ¯ éªŒè¯æ•ˆæœï¼šä¿®å¤åå¿…é¡»éªŒè¯æ•°æ®ä¸€è‡´æ€§
ğŸ¯ æŒç»­æ”¹è¿›ï¼šæ€»ç»“ç»éªŒï¼Œä¼˜åŒ–é¢„é˜²æªæ–½
```

### 14.5 å¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•


**âš ï¸ å…¸å‹è¿ç»´é”™è¯¯åŠé¢„é˜²**
```
å¸¸è§é”™è¯¯ç±»å‹ï¼š
âŒ ç›²ç›®è·³è¿‡é”™è¯¯ï¼šå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
   âœ… é¢„é˜²ï¼šå»ºç«‹é”™è¯¯è¯„ä¼°æœºåˆ¶ï¼Œè®°å½•è·³è¿‡åŸå› 

âŒ ç›´æ¥åœ¨ä»åº“å†™å…¥ï¼šç ´åå¤åˆ¶ä¸€è‡´æ€§  
   âœ… é¢„é˜²ï¼šè®¾ç½®read_only=1ï¼Œé™åˆ¶ä»åº“å†™å…¥

âŒ å¿½ç•¥ç½‘ç»œç›‘æ§ï¼šæ•…éšœå‘ç°æ»å
   âœ… é¢„é˜²ï¼šå»ºç«‹å®Œå–„çš„ç½‘ç»œç›‘æ§ä½“ç³»

âŒ å¤åˆ¶ç”¨æˆ·æƒé™è¿‡å¤§ï¼šå®‰å…¨é£é™©
   âœ… é¢„é˜²ï¼šéµå¾ªæœ€å°æƒé™åŸåˆ™

âŒ æœªå¤‡ä»½å¤åˆ¶çŠ¶æ€ï¼šæ•…éšœæ¢å¤å›°éš¾
   âœ… é¢„é˜²ï¼šå®šæœŸå¤‡ä»½SLAVE STATUSä¿¡æ¯

âŒ é…ç½®å‚æ•°ä¸å½“ï¼šå½±å“å¤åˆ¶æ€§èƒ½
   âœ… é¢„é˜²ï¼šæ ¹æ®ç¯å¢ƒä¼˜åŒ–é…ç½®å‚æ•°
```

### 14.6 åº”æ€¥å“åº”æ£€æŸ¥æ¸…å•


**ğŸš¨ æ•…éšœåº”æ€¥å¤„ç†æ£€æŸ¥æ¸…å•**
```
ğŸ“‹ æ•…éšœå‘ç”Ÿæ—¶çš„æ ‡å‡†æ£€æŸ¥æ¸…å•ï¼š

ç«‹å³æ£€æŸ¥ï¼ˆ5åˆ†é’Ÿå†…ï¼‰ï¼š
â–¡ å¤åˆ¶çŠ¶æ€ï¼šSHOW SLAVE STATUS\G
â–¡ é”™è¯¯ä¿¡æ¯ï¼šLast_IO_Error, Last_SQL_Error  
â–¡ ç½‘ç»œè¿æ¥ï¼špingä¸»åº“ï¼Œtelnet 3306ç«¯å£
â–¡ ä¸»åº“çŠ¶æ€ï¼šSHOW MASTER STATUSï¼ˆå¦‚æœå¯è®¿é—®ï¼‰
â–¡ ç³»ç»Ÿèµ„æºï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ

è¯¦ç»†åˆ†æï¼ˆ15åˆ†é’Ÿå†…ï¼‰ï¼š
â–¡ é”™è¯¯æ—¥å¿—ï¼šæŸ¥çœ‹MySQL error log
â–¡ ç½‘ç»œè´¨é‡ï¼šä¸¢åŒ…ç‡ã€å»¶è¿Ÿæ—¶é—´
â–¡ å¤åˆ¶å»¶è¿Ÿï¼šè¯„ä¼°æ•°æ®å·®è·å¤§å°  
â–¡ ä¸šåŠ¡å½±å“ï¼šè¯„ä¼°å¯¹ä¸šåŠ¡çš„å½±å“ç¨‹åº¦
â–¡ å†å²è¶‹åŠ¿ï¼šå¯¹æ¯”å†å²ç›‘æ§æ•°æ®

ä¿®å¤æ‰§è¡Œï¼ˆæ ¹æ®é—®é¢˜å¤æ‚åº¦ï¼‰ï¼š
â–¡ åˆ¶å®šä¿®å¤æ–¹æ¡ˆï¼šé€‰æ‹©åˆé€‚çš„ä¿®å¤æ–¹æ³•
â–¡ å¤‡ä»½å½“å‰çŠ¶æ€ï¼šè®°å½•ä¿®å¤å‰çš„çŠ¶æ€
â–¡ æ‰§è¡Œä¿®å¤æ“ä½œï¼šæŒ‰æ­¥éª¤è°¨æ…æ‰§è¡Œ
â–¡ éªŒè¯ä¿®å¤æ•ˆæœï¼šç¡®è®¤å¤åˆ¶æ¢å¤æ­£å¸¸
â–¡ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ï¼šéªŒè¯ä¸»ä»æ•°æ®ä¸€è‡´

åç»­è·Ÿè¿›ï¼š
â–¡ ç›‘æ§æ¢å¤æƒ…å†µï¼šè§‚å¯Ÿä¸€æ®µæ—¶é—´ç¡®ä¿ç¨³å®š
â–¡ æ€»ç»“æ•…éšœåŸå› ï¼šåˆ†ææ ¹æœ¬åŸå› 
â–¡ ä¼˜åŒ–é¢„é˜²æªæ–½ï¼šæ”¹è¿›ç›‘æ§å’Œé…ç½®
â–¡ æ–‡æ¡£åŒ–å¤„ç†è¿‡ç¨‹ï¼šæ›´æ–°è¿ç»´æ‰‹å†Œ
```

### 14.7 å­¦ä¹ è¿›é˜¶å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ æ–¹å‘**
```
è¿›é˜¶å­¦ä¹ è·¯å¾„ï¼š
ğŸ”¸ é«˜çº§å¤åˆ¶æ¶æ„ï¼šå¤šä¸»å¤åˆ¶ã€ç¯å½¢å¤åˆ¶ã€çº§è”å¤åˆ¶
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šå¤åˆ¶æ€§èƒ½è°ƒä¼˜ã€ç½‘ç»œä¼˜åŒ–ã€ç¡¬ä»¶ä¼˜åŒ–
ğŸ”¸ è‡ªåŠ¨åŒ–è¿ç»´ï¼šæ•…éšœè‡ªåŠ¨æ¢å¤ã€é…ç½®ç®¡ç†è‡ªåŠ¨åŒ–
ğŸ”¸ ç›‘æ§ç³»ç»Ÿï¼šPrometheus+Grafanaã€è‡ªå®šä¹‰ç›‘æ§å·¥å…·
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šæ›´æ·±å…¥çš„ä¸€è‡´æ€§æ£€æŸ¥å’Œä¿®å¤æŠ€æœ¯
ğŸ”¸ äº‘åŸç”Ÿå¤åˆ¶ï¼šå®¹å™¨åŒ–ç¯å¢ƒä¸‹çš„å¤åˆ¶ç®¡ç†
```

**ğŸ’¡ å®è·µå»ºè®®**
```
å®è·µæå‡æ–¹æ³•ï¼š
âœ… æ­å»ºæµ‹è¯•ç¯å¢ƒï¼šæ¨¡æ‹Ÿå„ç§æ•…éšœåœºæ™¯
âœ… å®šæœŸæ¼”ç»ƒï¼šæ•…éšœæ¼”ç»ƒå’Œæ¢å¤æµç¨‹
âœ… é˜…è¯»æºç ï¼šç†è§£MySQLå¤åˆ¶çš„åº•å±‚æœºåˆ¶
âœ… ç¤¾åŒºäº¤æµï¼šå‚ä¸MySQLç¤¾åŒºè®¨è®º
âœ… æ¡ˆä¾‹ç§¯ç´¯ï¼šæ”¶é›†å’Œåˆ†æçœŸå®æ•…éšœæ¡ˆä¾‹
âœ… å·¥å…·ç†Ÿç»ƒï¼šæŒæ¡ç›¸å…³è¿ç»´å·¥å…·çš„ä½¿ç”¨
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€**
> å¤åˆ¶æ•…éšœä¸è¦æ…Œï¼ŒçŠ¶æ€æ£€æŸ¥æ˜¯å…³é”®
> IOå¼‚å¸¸æŸ¥ç½‘ç»œï¼ŒSQLé”™è¯¯çœ‹å†²çª  
> å»¶è¿Ÿè¿‡å¤§ä¼˜æ€§èƒ½ï¼Œæƒé™é—®é¢˜é‡æˆæƒ
> è·³è¿‡é”™è¯¯éœ€è°¨æ…ï¼Œæ•°æ®ä¸€è‡´æ˜¯æ ¹æœ¬
> ç›‘æ§å‘Šè­¦è¦å®Œå–„ï¼Œé¢„é˜²èƒœè¿‡äºæ²»ç–—

**æœ€ç»ˆå»ºè®®**: MySQLä¸»ä»å¤åˆ¶æ•…éšœå¤„ç†éœ€è¦ç³»ç»Ÿæ€§çš„çŸ¥è¯†å’Œä¸°å¯Œçš„å®è·µç»éªŒã€‚ç†è§£å¤åˆ¶åŸç†æ˜¯åŸºç¡€ï¼ŒæŒæ¡æ•…éšœè¯Šæ–­æ–¹æ³•æ˜¯å…³é”®ï¼Œå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»æ˜¯ä¿éšœã€‚åœ¨å¤„ç†æ•…éšœæ—¶è¦å†·é™åˆ†æã€è°¨æ…æ“ä½œã€å®Œæ•´éªŒè¯ï¼Œç¡®ä¿æ•°æ®å®‰å…¨å’Œä¸šåŠ¡è¿ç»­æ€§ã€‚