---
title: 30ã€å‡çº§æ•…éšœæ¡ˆä¾‹
---
## ğŸ“š ç›®å½•

1. [MySQLå‡çº§æ•…éšœæ¦‚è¿°](#1-MySQLå‡çº§æ•…éšœæ¦‚è¿°)
2. [ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜](#2-ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜)
3. [å‡çº§è¿‡ç¨‹ä¸­æ–­å¤„ç†](#3-å‡çº§è¿‡ç¨‹ä¸­æ–­å¤„ç†)
4. [æ•°æ®å­—å…¸å‡çº§å¤±è´¥](#4-æ•°æ®å­—å…¸å‡çº§å¤±è´¥)
5. [é…ç½®å‚æ•°è¿ç§»é—®é¢˜](#5-é…ç½®å‚æ•°è¿ç§»é—®é¢˜)
6. [åº”ç”¨å…¼å®¹æ€§æµ‹è¯•](#6-åº”ç”¨å…¼å®¹æ€§æµ‹è¯•)
7. [å›æ»šå‡çº§æ“ä½œ](#7-å›æ»šå‡çº§æ“ä½œ)
8. [å‡çº§ç­–ç•¥ä¸æœ€ä½³å®è·µ](#8-å‡çº§ç­–ç•¥ä¸æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ MySQLå‡çº§æ•…éšœæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯MySQLå‡çº§æ•…éšœ


**å‡çº§æ•…éšœå®šä¹‰**ï¼šMySQLç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­å‡ºç°çš„å„ç§å¼‚å¸¸ï¼Œå¯¼è‡´æ•°æ®åº“æ— æ³•æ­£å¸¸å¯åŠ¨æˆ–åŠŸèƒ½å¼‚å¸¸çš„é—®é¢˜ã€‚

```
å‡çº§æ•…éšœçš„æœ¬è´¨ï¼š
æ•°æ®åº“ä»æ—§ç‰ˆæœ¬ â†’ æ–°ç‰ˆæœ¬çš„è¿‡ç¨‹ä¸­
å› ä¸ºå…¼å®¹æ€§ã€é…ç½®ã€æ•°æ®ç»“æ„ç­‰å·®å¼‚
é€ æˆçš„å„ç§é—®é¢˜

å°±åƒæ¬å®¶ä¸€æ ·ï¼š
æ—§æˆ¿å­(MySQL 5.7) â†’ æ–°æˆ¿å­(MySQL 8.0)
å¯èƒ½å‡ºç°ï¼šé’¥åŒ™ä¸åŒ¹é…ã€å®¶å…·æ”¾ä¸ä¸‹ã€æ’åº§ä¸å…¼å®¹ç­‰é—®é¢˜
```

### 1.2 å¸¸è§å‡çº§æ•…éšœç±»å‹


**ğŸ”¸ æŒ‰æ•…éšœé˜¶æ®µåˆ†ç±»**
```
å‡çº§å‰é˜¶æ®µæ•…éšœï¼š
â€¢ ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥å¤±è´¥
â€¢ å¤‡ä»½éªŒè¯ä¸é€šè¿‡
â€¢ ä¾èµ–ç»„ä»¶ç‰ˆæœ¬å†²çª

å‡çº§ä¸­é˜¶æ®µæ•…éšœï¼š
â€¢ å‡çº§è¿‡ç¨‹ä¸­æ–­
â€¢ æ•°æ®å­—å…¸å‡çº§å¤±è´¥
â€¢ é…ç½®æ–‡ä»¶è½¬æ¢é”™è¯¯

å‡çº§åé˜¶æ®µæ•…éšœï¼š
â€¢ åº”ç”¨è¿æ¥å¤±è´¥
â€¢ æ€§èƒ½ä¸¥é‡ä¸‹é™
â€¢ åŠŸèƒ½å¼‚å¸¸
```

**ğŸ”¸ æŒ‰å½±å“ç¨‹åº¦åˆ†ç±»**
```
ğŸ”´ è‡´å‘½æ•…éšœï¼šæ•°æ®åº“æ— æ³•å¯åŠ¨
ğŸŸ¡ åŠŸèƒ½æ•…éšœï¼šéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸
ğŸŸ¢ æ€§èƒ½æ•…éšœï¼šå“åº”é€Ÿåº¦ä¸‹é™
```

### 1.3 å‡çº§æ•…éšœå½±å“åˆ†æ


**ä¸šåŠ¡å½±å“è¯„ä¼°**
```
åœæœºæ—¶é—´ï¼š
â€¢ è®¡åˆ’å†…ï¼š2-4å°æ—¶(æ­£å¸¸å‡çº§)
â€¢ æ•…éšœåï¼š8-24å°æ—¶(å«æ•…éšœå¤„ç†)

æ•°æ®é£é™©ï¼š
â€¢ æ•°æ®ä¸¢å¤±ï¼šæå°‘è§ä½†å½±å“å·¨å¤§
â€¢ æ•°æ®ä¸ä¸€è‡´ï¼šéœ€è¦ä¿®å¤éªŒè¯
â€¢ æ€§èƒ½ä¸‹é™ï¼šå½±å“ç”¨æˆ·ä½“éªŒ

æˆæœ¬å½±å“ï¼š
â€¢ äººåŠ›æˆæœ¬ï¼šDBAå›¢é˜ŸåŠ ç­å¤„ç†
â€¢ ä¸šåŠ¡æŸå¤±ï¼šæœåŠ¡ä¸å¯ç”¨é€ æˆçš„æŸå¤±
â€¢ å›æ»šæˆæœ¬ï¼šå¯èƒ½éœ€è¦é‡æ–°è§„åˆ’
```

---

## 2. âš ï¸ ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜


### 2.1 ä¸»è¦ç‰ˆæœ¬å…¼å®¹æ€§å·®å¼‚


**MySQL 5.7 â†’ 8.0 é‡å¤§å˜åŒ–**
```
è®¤è¯æ–¹å¼å˜æ›´ï¼š
MySQL 5.7: mysql_native_password (é»˜è®¤)
MySQL 8.0: caching_sha2_password (é»˜è®¤)

å½±å“ï¼šæ—§å®¢æˆ·ç«¯æ— æ³•è¿æ¥æ–°æœåŠ¡å™¨
```

**ğŸ”§ å…¼å®¹æ€§æ£€æŸ¥å·¥å…·**
```bash
# MySQLå‡çº§æ£€æŸ¥å·¥å…·
mysqlcheck --all-databases --check-upgrade

# ç¤ºä¾‹è¾“å‡º
mysql.user                     OK
mysql.db                       OK  
test.users                     Warning: è¡¨ç»“æ„éœ€è¦å‡çº§
```

### 2.2 å…¸å‹å…¼å®¹æ€§é—®é¢˜æ¡ˆä¾‹


**æ¡ˆä¾‹1ï¼šå­—ç¬¦é›†å…¼å®¹æ€§é—®é¢˜**
```sql
-- é—®é¢˜ï¼šMySQL 8.0é»˜è®¤å­—ç¬¦é›†å˜æ›´
-- MySQL 5.7: latin1
-- MySQL 8.0: utf8mb4

-- æ•…éšœç°è±¡
ERROR 1366: Incorrect string value: '\xE4\xB8\xAD\xE6\x96\x87' 

-- è§£å†³æ–¹æ¡ˆ
ALTER DATABASE mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE mytable CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

**æ¡ˆä¾‹2ï¼šSQLæ¨¡å¼å…¼å®¹æ€§**
```sql
-- é—®é¢˜ï¼šMySQL 8.0 SQLæ¨¡å¼æ›´ä¸¥æ ¼
-- æ•…éšœç°è±¡ï¼šåŸæœ¬èƒ½æ‰§è¡Œçš„SQLæŠ¥é”™

-- åŸå§‹SQLï¼ˆMySQL 5.7æ­£å¸¸ï¼‰
SELECT name, COUNT(*) FROM users;  -- æŠ¥é”™ï¼šéèšåˆåˆ—

-- è§£å†³æ–¹æ¡ˆ1ï¼šä¿®æ”¹SQL
SELECT name, COUNT(*) FROM users GROUP BY name;

-- è§£å†³æ–¹æ¡ˆ2ï¼šè°ƒæ•´SQLæ¨¡å¼
SET sql_mode = 'TRADITIONAL,NO_ENGINE_SUBSTITUTION';
```

### 2.3 å…¼å®¹æ€§é¢„æ£€æµ‹


**ğŸ“‹ å‡çº§å‰æ£€æµ‹æ¸…å•**
```bash
# 1. æ£€æŸ¥ä¸å…¼å®¹çš„è¡¨ç»“æ„
SELECT TABLE_SCHEMA, TABLE_NAME, ENGINE 
FROM information_schema.TABLES 
WHERE ENGINE = 'MyISAM';

# 2. æ£€æŸ¥åºŸå¼ƒçš„æ•°æ®ç±»å‹
SELECT TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME, DATA_TYPE
FROM information_schema.COLUMNS
WHERE DATA_TYPE IN ('YEAR(2)', 'TIMESTAMP(0)');

# 3. æ£€æŸ¥ä¿ç•™å­—å†²çª
-- MySQL 8.0æ–°å¢ä¿ç•™å­—ï¼šRANK, DENSE_RANKç­‰
SELECT TABLE_NAME FROM information_schema.TABLES 
WHERE TABLE_NAME IN ('rank', 'groups', 'system');
```

---

## 3. ğŸ’¥ å‡çº§è¿‡ç¨‹ä¸­æ–­å¤„ç†


### 3.1 å‡çº§ä¸­æ–­çš„å¸¸è§åŸå› 


**ğŸ”¸ ç³»ç»Ÿèµ„æºä¸è¶³**
```
ç£ç›˜ç©ºé—´ä¸è¶³ï¼š
é—®é¢˜ï¼šå‡çº§éœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨ä¸­é—´æ–‡ä»¶
ç°è±¡ï¼šERROR: No space left on device
è§£å†³ï¼šæ¸…ç†ç©ºé—´æˆ–æ‰©å®¹åé‡æ–°å‡çº§

å†…å­˜ä¸è¶³ï¼š
é—®é¢˜ï¼šå¤§è¡¨å‡çº§æ¶ˆè€—å¤§é‡å†…å­˜
ç°è±¡ï¼šè¿›ç¨‹è¢«OOM killeræ€æ­»
è§£å†³ï¼šå¢åŠ å†…å­˜æˆ–è°ƒæ•´å‡çº§å‚æ•°
```

**ğŸ”¸ ç½‘ç»œè¿æ¥ä¸­æ–­**
```
é—®é¢˜åœºæ™¯ï¼š
â€¢ è¿œç¨‹å‡çº§è¿‡ç¨‹ä¸­ç½‘ç»œæ–­å¼€
â€¢ SSHè¿æ¥è¶…æ—¶
â€¢ é˜²ç«å¢™è§„åˆ™å˜æ›´

é¢„é˜²æªæ–½ï¼š
ä½¿ç”¨screenæˆ–nohupæ‰§è¡Œå‡çº§å‘½ä»¤
nohup mysql_upgrade & 
```

### 3.2 ä¸­æ–­åçŠ¶æ€åˆ¤æ–­


**ğŸ” å‡çº§çŠ¶æ€æ£€æµ‹**
```sql
-- æ£€æŸ¥MySQLç‰ˆæœ¬ä¿¡æ¯
SELECT VERSION();

-- æ£€æŸ¥å‡çº§çŠ¶æ€
SELECT * FROM mysql.schema_version;

-- æ£€æŸ¥æ•°æ®å­—å…¸ç‰ˆæœ¬
SELECT * FROM mysql.dd_properties 
WHERE properties LIKE '%version%';
```

**ğŸ“Š ä¸­æ–­çŠ¶æ€åˆ†ç±»**
```
å®Œå…¨å›æ»šçŠ¶æ€ï¼š
â€¢ æ•°æ®åº“ä»æ˜¯åŸç‰ˆæœ¬
â€¢ æ•°æ®å®Œæ•´æ€§æ­£å¸¸
â€¢ å¯ä»¥æ­£å¸¸å¯åŠ¨ä½¿ç”¨

éƒ¨åˆ†å‡çº§çŠ¶æ€ï¼š
â€¢ äºŒè¿›åˆ¶æ–‡ä»¶å·²å‡çº§
â€¢ æ•°æ®å­—å…¸å‡çº§æœªå®Œæˆ
â€¢ å¯èƒ½æ— æ³•æ­£å¸¸å¯åŠ¨

æ··ä¹±çŠ¶æ€ï¼š
â€¢ ç‰ˆæœ¬ä¿¡æ¯ä¸ä¸€è‡´
â€¢ éƒ¨åˆ†è¡¨ç»“æ„å·²å˜æ›´
â€¢ éœ€è¦äººå·¥å¹²é¢„ä¿®å¤
```

### 3.3 ä¸­æ–­æ¢å¤å¤„ç†


**æ¢å¤å¤„ç†æµç¨‹**
```bash
# 1. åœæ­¢MySQLæœåŠ¡
systemctl stop mysql

# 2. æ£€æŸ¥é”™è¯¯æ—¥å¿—
tail -100 /var/log/mysql/error.log

# 3. å°è¯•å®‰å…¨å¯åŠ¨
mysqld_safe --skip-grant-tables --skip-networking &

# 4. ç»§ç»­å‡çº§è¿‡ç¨‹
mysql_upgrade --force

# 5. é‡å¯æœåŠ¡
systemctl restart mysql
```

---

## 4. ğŸ“‹ æ•°æ®å­—å…¸å‡çº§å¤±è´¥


### 4.1 ä»€ä¹ˆæ˜¯æ•°æ®å­—å…¸å‡çº§


**æ•°æ®å­—å…¸æ¦‚å¿µ**ï¼šMySQLç”¨æ¥å­˜å‚¨è¡¨ç»“æ„ã€ç´¢å¼•ã€æƒé™ç­‰å…ƒæ•°æ®çš„ç³»ç»Ÿè¡¨é›†åˆã€‚

```
æ•°æ®å­—å…¸çš„ä½œç”¨ï¼š
å°±åƒå›¾ä¹¦é¦†çš„ç›®å½•å¡ç‰‡
è®°å½•äº†æ‰€æœ‰è¡¨çš„ç»“æ„ä¿¡æ¯
MySQLå¯åŠ¨æ—¶éœ€è¦è¯»å–è¿™äº›ä¿¡æ¯

MySQL 8.0å˜åŒ–ï¼š
â€¢ å°†æ•°æ®å­—å…¸å­˜å‚¨æ–¹å¼å®Œå…¨é‡å†™
â€¢ ä»æ–‡ä»¶å­˜å‚¨æ”¹ä¸ºInnoDBè¡¨å­˜å‚¨
â€¢ æå‡äº†æ“ä½œåŸå­æ€§å’Œä¸€è‡´æ€§
```

### 4.2 æ•°æ®å­—å…¸å‡çº§å¤±è´¥åŸå› 


**ğŸ”¸ å¸¸è§å¤±è´¥åœºæ™¯**
```
è¡¨ç»“æ„ä¸å…¼å®¹ï¼š
â€¢ ä½¿ç”¨äº†åºŸå¼ƒçš„æ•°æ®ç±»å‹
â€¢ è¡¨åä½¿ç”¨äº†æ–°ç‰ˆæœ¬ä¿ç•™å­—
â€¢ å¤–é”®çº¦æŸä¸æ»¡è¶³æ–°ç‰ˆæœ¬è¦æ±‚

æƒé™æ•°æ®é—®é¢˜ï¼š
â€¢ mysql.userè¡¨æ•°æ®æŸå
â€¢ æƒé™ä¿¡æ¯æ ¼å¼ä¸å…¼å®¹
â€¢ å­˜åœ¨æ— æ•ˆçš„æƒé™è®°å½•

ç³»ç»Ÿè¡¨æŸåï¼š
â€¢ information_schemaæ•°æ®ä¸ä¸€è‡´
â€¢ performance_schemaå‡çº§å¤±è´¥
â€¢ æ—¥å¿—è¡¨ç»“æ„å¼‚å¸¸
```

**å…¸å‹é”™è¯¯ä¿¡æ¯**
```
[ERROR] Data Dictionary initialization failed.
[ERROR] Aborting
[ERROR] Plugin 'mysql_native_password' cannot be loaded
```

### 4.3 æ•°æ®å­—å…¸ä¿®å¤æ–¹æ³•


**ğŸ”§ ä¿®å¤æ­¥éª¤**
```bash
# 1. ä½¿ç”¨æ—§ç‰ˆæœ¬å¯åŠ¨(å¦‚æœå¯èƒ½)
mysqld --skip-grant-tables --datadir=/var/lib/mysql

# 2. æ£€æŸ¥ç³»ç»Ÿè¡¨
mysql -e "CHECK TABLE mysql.user, mysql.db, mysql.tables_priv;"

# 3. ä¿®å¤æŸåçš„è¡¨
mysql -e "REPAIR TABLE mysql.user;"

# 4. æ¸…ç†æ— æ•ˆæ•°æ®
mysql -e "DELETE FROM mysql.user WHERE User='' AND Host='';"

# 5. é‡æ–°å°è¯•å‡çº§
mysql_upgrade --upgrade-system-tables
```

**âš ï¸ æç«¯æƒ…å†µå¤„ç†**
```sql
-- å¦‚æœæ— æ³•ä¿®å¤ï¼Œé‡å»ºæƒé™è¡¨
-- æ³¨æ„ï¼šè¿™ä¼šä¸¢å¤±æ‰€æœ‰æƒé™è®¾ç½®

# 1. å¯¼å‡ºæƒé™æ•°æ®
mysqldump mysql > mysql_backup.sql

# 2. é‡æ–°åˆå§‹åŒ–æ•°æ®ç›®å½•  
mysql_install_db --datadir=/var/lib/mysql

# 3. æ‰‹å·¥æ¢å¤å…³é”®æƒé™
```

---

## 5. âš™ï¸ é…ç½®å‚æ•°è¿ç§»é—®é¢˜


### 5.1 é…ç½®å‚æ•°å˜æ›´æ¦‚è¿°


**å‚æ•°å˜æ›´ç±»å‹**
```
åºŸå¼ƒå‚æ•°ï¼š
â€¢ åœ¨æ–°ç‰ˆæœ¬ä¸­å®Œå…¨ç§»é™¤
â€¢ å¯åŠ¨æ—¶ä¼šæŠ¥é”™æˆ–è­¦å‘Š
â€¢ éœ€è¦ä»é…ç½®æ–‡ä»¶ä¸­åˆ é™¤

é‡å‘½åå‚æ•°ï¼š
â€¢ å‚æ•°åç§°å‘ç”Ÿå˜åŒ–
â€¢ åŠŸèƒ½åŸºæœ¬ç›¸åŒ
â€¢ éœ€è¦æ›´æ–°é…ç½®æ–‡ä»¶

é»˜è®¤å€¼å˜æ›´ï¼š
â€¢ å‚æ•°åä¸å˜ï¼Œé»˜è®¤å€¼æ”¹å˜
â€¢ å¯èƒ½å½±å“æ€§èƒ½æˆ–è¡Œä¸º
â€¢ éœ€è¦æ˜¾å¼è®¾ç½®æœŸæœ›å€¼
```

### 5.2 å¸¸è§å‚æ•°è¿ç§»é—®é¢˜


**æ¡ˆä¾‹1ï¼šæŸ¥è¯¢ç¼“å­˜å‚æ•°åºŸå¼ƒ**
```ini
# MySQL 5.7é…ç½®
[mysqld]
query_cache_type = 1
query_cache_size = 268435456

# é—®é¢˜ï¼šMySQL 8.0ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½
# é”™è¯¯ä¿¡æ¯
[Warning] option 'query_cache_type': unknown variable

# è§£å†³ï¼šåˆ é™¤ç›¸å…³é…ç½®
[mysqld]
# query_cache_type = 1        # åˆ é™¤æ­¤è¡Œ
# query_cache_size = 268435456  # åˆ é™¤æ­¤è¡Œ
```

**æ¡ˆä¾‹2ï¼šæ—¥å¿—å‚æ•°é‡å‘½å**
```ini
# MySQL 5.7é…ç½®
log-bin-trust-function-creators = 1

# MySQL 8.0é…ç½®  
log_bin_trust_function_creators = 1  # ä¸‹åˆ’çº¿æ›¿æ¢è¿å­—ç¬¦
```

### 5.3 é…ç½®è¿ç§»æœ€ä½³å®è·µ


**ğŸ“ é…ç½®æ£€æŸ¥å·¥å…·**
```bash
# åˆ›å»ºé…ç½®æ£€æŸ¥è„šæœ¬
#!/bin/bash
# check_config.sh

echo "æ£€æŸ¥MySQLé…ç½®å…¼å®¹æ€§..."

# æ£€æŸ¥åºŸå¼ƒå‚æ•°
deprecated_params="query_cache_type query_cache_size tx_isolation"
for param in $deprecated_params; do
    if grep -q "$param" /etc/mysql/my.cnf; then
        echo "è­¦å‘Š: å‘ç°åºŸå¼ƒå‚æ•° $param"
    fi
done

# æ£€æŸ¥å‚æ•°æ ¼å¼
if grep -q "log-bin-trust" /etc/mysql/my.cnf; then
    echo "å»ºè®®: ä½¿ç”¨ä¸‹åˆ’çº¿æ ¼å¼ log_bin_trust_function_creators"
fi
```

**ğŸ¯ å‚æ•°è¿ç§»checklist**
```
å‡çº§å‰æ£€æŸ¥ï¼š
â–¡ å¤‡ä»½åŸé…ç½®æ–‡ä»¶
â–¡ è¯†åˆ«åºŸå¼ƒå‚æ•°
â–¡ æ£€æŸ¥é»˜è®¤å€¼å˜æ›´
â–¡ å‡†å¤‡æ–°ç‰ˆæœ¬é…ç½®

å‡çº§åéªŒè¯ï¼š
â–¡ æ£€æŸ¥å¯åŠ¨æ—¥å¿—ä¸­çš„è­¦å‘Š
â–¡ éªŒè¯å…³é”®å‚æ•°ç”Ÿæ•ˆ
â–¡ ç¡®è®¤æ€§èƒ½è¡¨ç°æ­£å¸¸
â–¡ æµ‹è¯•å„é¡¹åŠŸèƒ½
```

---

## 6. ğŸ”— åº”ç”¨å…¼å®¹æ€§æµ‹è¯•


### 6.1 åº”ç”¨å…¼å®¹æ€§æµ‹è¯•çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦å…¼å®¹æ€§æµ‹è¯•**
```
æ•°æ®åº“å‡çº§å½±å“é¢ï¼š
â€¢ SQLè¯­æ³•å˜åŒ–
â€¢ è¿æ¥æ–¹å¼å˜æ›´  
â€¢ æ€§èƒ½ç‰¹å¾å·®å¼‚
â€¢ é”™è¯¯å¤„ç†æ–¹å¼æ”¹å˜

åº”ç”¨å±‚é¢çš„å½±å“ï¼š
â€¢ ORMæ¡†æ¶å…¼å®¹æ€§
â€¢ è¿æ¥æ± é…ç½®
â€¢ äº‹åŠ¡å¤„ç†é€»è¾‘
â€¢ é”™è¯¯å¤„ç†æœºåˆ¶
```

### 6.2 å…¼å®¹æ€§æµ‹è¯•æ–¹æ³•


**ğŸ”¸ åŠŸèƒ½æµ‹è¯•**
```java
// è¿æ¥æµ‹è¯•ç¤ºä¾‹
public class MySQLCompatibilityTest {
    
    @Test
    public void testConnection() {
        String url = "jdbc:mysql://localhost:3306/testdb?useSSL=false";
        try (Connection conn = DriverManager.getConnection(url, "user", "pass")) {
            assertTrue("è¿æ¥æˆåŠŸ", conn.isValid(5));
        } catch (SQLException e) {
            fail("è¿æ¥å¤±è´¥: " + e.getMessage());
        }
    }
    
    @Test  
    public void testBasicOperations() {
        // æµ‹è¯•åŸºæœ¬CRUDæ“ä½œ
        String sql = "SELECT COUNT(*) FROM users WHERE status = ?";
        // éªŒè¯æŸ¥è¯¢ç»“æœæ­£ç¡®æ€§
    }
}
```

**ğŸ”¸ æ€§èƒ½æµ‹è¯•**
```bash
# ä½¿ç”¨sysbenchè¿›è¡Œæ€§èƒ½å¯¹æ¯”æµ‹è¯•
sysbench oltp_read_write \
  --mysql-host=localhost \
  --mysql-user=test \
  --mysql-password=test \
  --mysql-db=testdb \
  --tables=10 \
  --table-size=100000 \
  run
```

### 6.3 å¸¸è§åº”ç”¨å…¼å®¹æ€§é—®é¢˜


**é—®é¢˜1ï¼šè®¤è¯æ’ä»¶ä¸å…¼å®¹**
```java
// é”™è¯¯ç°è±¡
SQLException: Plugin caching_sha2_password could not be loaded

// è§£å†³æ–¹æ¡ˆ1ï¼šå‡çº§MySQLé©±åŠ¨
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.33</version>  <!-- ä½¿ç”¨8.xç‰ˆæœ¬ -->
</dependency>

// è§£å†³æ–¹æ¡ˆ2ï¼šä¿®æ”¹ç”¨æˆ·è®¤è¯æ–¹å¼
ALTER USER 'app_user'@'%' IDENTIFIED WITH mysql_native_password BY 'password';
```

**é—®é¢˜2ï¼šæ—¶é—´å¤„ç†å·®å¼‚**
```sql
-- MySQL 5.7 è¡Œä¸º
SELECT NOW(6);  -- è¿”å›å¾®ç§’ç²¾åº¦

-- MySQL 8.0 å¯èƒ½çš„é—®é¢˜
-- æŸäº›åº”ç”¨å‡è®¾æ—¶é—´æ ¼å¼å›ºå®šï¼Œå¯¼è‡´è§£æå¤±è´¥

-- è§£å†³æ–¹æ¡ˆï¼šæ ‡å‡†åŒ–æ—¶é—´å¤„ç†
SELECT DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s') as formatted_time;
```

---

## 7. ğŸ”„ å›æ»šå‡çº§æ“ä½œ


### 7.1 ä»€ä¹ˆæ—¶å€™éœ€è¦å›æ»š


**å›æ»šè§¦å‘æ¡ä»¶**
```
ğŸ”´ å¿…é¡»å›æ»šæƒ…å†µï¼š
â€¢ æ•°æ®åº“æ— æ³•å¯åŠ¨
â€¢ æ•°æ®å®Œæ•´æ€§é—®é¢˜
â€¢ å…³é”®ä¸šåŠ¡åŠŸèƒ½å¤±æ•ˆ
â€¢ æ€§èƒ½ä¸¥é‡ä¸‹é™(>50%)

ğŸŸ¡ è€ƒè™‘å›æ»šæƒ…å†µï¼š
â€¢ éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸
â€¢ ç›‘æ§å‘Šè­¦é¢‘ç¹
â€¢ ç”¨æˆ·æŠ•è¯‰å¢åŠ 
â€¢ ä¿®å¤æ—¶é—´è¿‡é•¿
```

### 7.2 å›æ»šæ“ä½œç±»å‹


**ğŸ”¸ å®Œæ•´å›æ»š**
```bash
# 1. åœæ­¢æ–°ç‰ˆæœ¬MySQL
systemctl stop mysql

# 2. æ¢å¤æ•°æ®ç›®å½•
rm -rf /var/lib/mysql
cp -r /backup/mysql_data_before_upgrade /var/lib/mysql

# 3. æ¢å¤é…ç½®æ–‡ä»¶
cp /backup/my.cnf.backup /etc/mysql/my.cnf

# 4. å®‰è£…æ—§ç‰ˆæœ¬MySQL
yum downgrade mysql-server-5.7.44

# 5. å¯åŠ¨æœåŠ¡
systemctl start mysql
```

**ğŸ”¸ éƒ¨åˆ†å›æ»š**
```sql
-- ä»…å›æ»šåº”ç”¨å±‚é…ç½®
-- ä¿æŒæ•°æ®åº“ç‰ˆæœ¬ä¸å˜ï¼Œè°ƒæ•´å…¼å®¹æ€§è®¾ç½®

-- è®¾ç½®SQLæ¨¡å¼å…¼å®¹æ—§ç‰ˆæœ¬
SET GLOBAL sql_mode = 'ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';

-- è°ƒæ•´è®¤è¯æ–¹å¼
ALTER USER 'app_user'@'%' IDENTIFIED WITH mysql_native_password BY 'password';
```

### 7.3 å›æ»šæ³¨æ„äº‹é¡¹


**âš ï¸ å›æ»šé£é™©è¯„ä¼°**
```
æ•°æ®é£é™©ï¼š
â€¢ å›æ»šåä¼šä¸¢å¤±å‡çº§æœŸé—´çš„æ•°æ®å˜æ›´
â€¢ éœ€è¦è¯„ä¼°æ•°æ®ä¸¢å¤±çš„å½±å“èŒƒå›´
â€¢ åˆ¶å®šæ•°æ®è¡¥å¿æ–¹æ¡ˆ

æ—¶é—´çª—å£ï¼š
â€¢ å›æ»šæ“ä½œæœ¬èº«éœ€è¦æ—¶é—´
â€¢ æ€»åœæœºæ—¶é—´å¯èƒ½å»¶é•¿
â€¢ éœ€è¦å’Œä¸šåŠ¡æ–¹æ²Ÿé€š

æ“ä½œå¤æ‚æ€§ï¼š
â€¢ éœ€è¦å‡†ç¡®çš„å¤‡ä»½æ–‡ä»¶
â€¢ é…ç½®æ¢å¤å¯èƒ½é—æ¼
â€¢ æƒé™è®¾ç½®éœ€è¦é‡æ–°éªŒè¯
```

**ğŸ¯ å›æ»šå†³ç­–çŸ©é˜µ**
| æ•…éšœä¸¥é‡ç¨‹åº¦ | ä¿®å¤æ—¶é—´é¢„ä¼° | ä¸šåŠ¡å½±å“ | å»ºè®®æ“ä½œ |
|-------------|-------------|---------|---------|
| ğŸ”´ ä¸¥é‡ | >4å°æ—¶ | é«˜ | **ç«‹å³å›æ»š** |
| ğŸŸ¡ ä¸­ç­‰ | 2-4å°æ—¶ | ä¸­ | è¯„ä¼°åå†³å®š |
| ğŸŸ¢ è½»å¾® | <2å°æ—¶ | ä½ | ç»§ç»­ä¿®å¤ |

---

## 8. ğŸ“ˆ å‡çº§ç­–ç•¥ä¸æœ€ä½³å®è·µ


### 8.1 æ»šåŠ¨å‡çº§ç­–ç•¥


**ä»€ä¹ˆæ˜¯æ»šåŠ¨å‡çº§**
```
æ»šåŠ¨å‡çº§å®šä¹‰ï¼š
åœ¨é›†ç¾¤ç¯å¢ƒä¸­ï¼Œé€ä¸ªå‡çº§èŠ‚ç‚¹
ä¿è¯æœåŠ¡æŒç»­å¯ç”¨çš„å‡çº§æ–¹å¼

é€‚ç”¨åœºæ™¯ï¼š
â€¢ MySQLä¸»ä»å¤åˆ¶ç¯å¢ƒ
â€¢ MySQLé›†ç¾¤(MGR/NDB)
â€¢ è¯»å†™åˆ†ç¦»æ¶æ„
```

**ğŸ”¸ ä¸»ä»ç¯å¢ƒæ»šåŠ¨å‡çº§**
```bash
# æ»šåŠ¨å‡çº§æ­¥éª¤
# 1. å…ˆå‡çº§ä»åº“
echo "å‡çº§ä»åº“slave1..."
# åœæ­¢ä»åº“
mysql -h slave1 -e "STOP SLAVE;"
# å‡çº§ä»åº“
upgrade_mysql_on_slave1.sh
# å¯åŠ¨ä»åº“å¹¶éªŒè¯
mysql -h slave1 -e "START SLAVE; SHOW SLAVE STATUS\G"

# 2. åˆ‡æ¢ä¸»ä»è§’è‰²
echo "ä¸»ä»åˆ‡æ¢..."
mysql -h master -e "SHOW MASTER STATUS;"
# æ‰§è¡Œä¸»ä»åˆ‡æ¢è„šæœ¬
failover_to_slave1.sh

# 3. å‡çº§åŸä¸»åº“
echo "å‡çº§åŸä¸»åº“..."
upgrade_mysql_on_old_master.sh
```

### 8.2 å‡çº§é£é™©è¯„ä¼°


**ğŸ“Š é£é™©è¯„ä¼°æ¡†æ¶**
```
æŠ€æœ¯é£é™©è¯„ä¼°ï¼š
â–¡ ç‰ˆæœ¬è·¨åº¦ (å¤§ç‰ˆæœ¬ vs å°ç‰ˆæœ¬)
â–¡ æ•°æ®é‡å¤§å° (TBçº§éœ€è¦æ›´å¤šæ—¶é—´)
â–¡ æ¶æ„å¤æ‚åº¦ (å•æœº vs é›†ç¾¤)
â–¡ å†å²é—®é¢˜ (æ˜¯å¦æœ‰å·²çŸ¥bug)

ä¸šåŠ¡é£é™©è¯„ä¼°ï¼š
â–¡ ä¸šåŠ¡é‡è¦ç¨‹åº¦ (æ ¸å¿ƒä¸šåŠ¡ vs è¾¹ç¼˜ä¸šåŠ¡)
â–¡ åœæœºæ—¶é—´å®¹å¿åº¦ (ç§’çº§ vs å°æ—¶çº§)
â–¡ å›æ»šå¤æ‚åº¦ (æ•°æ®ä¾èµ–å…³ç³»)
â–¡ å½±å“ç”¨æˆ·èŒƒå›´ (å†…éƒ¨ vs å¤–éƒ¨ç”¨æˆ·)
```

**ğŸ¯ é£é™©çŸ©é˜µ**
```
          ä½å½±å“    ä¸­å½±å“    é«˜å½±å“
ä½æ¦‚ç‡   âœ…ç»§ç»­    âœ…ç»§ç»­    âš ï¸è¯„ä¼°
ä¸­æ¦‚ç‡   âœ…ç»§ç»­    âš ï¸è¯„ä¼°    âŒå»¶æœŸ  
é«˜æ¦‚ç‡   âš ï¸è¯„ä¼°    âŒå»¶æœŸ    âŒå»¶æœŸ
```

### 8.3 å‡çº§å‰å¤‡ä»½éªŒè¯


**ğŸ”¸ å¤‡ä»½éªŒè¯æ¸…å•**
```bash
#!/bin/bash
# backup_verification.sh

echo "=== MySQLå‡çº§å‰å¤‡ä»½éªŒè¯ ==="

# 1. å…¨é‡å¤‡ä»½
echo "æ‰§è¡Œå…¨é‡å¤‡ä»½..."
mysqldump --all-databases --routines --triggers > full_backup_$(date +%Y%m%d).sql

# 2. éªŒè¯å¤‡ä»½å®Œæ•´æ€§
echo "éªŒè¯å¤‡ä»½æ–‡ä»¶..."
if mysql < full_backup_$(date +%Y%m%d).sql; then
    echo "âœ… å¤‡ä»½æ–‡ä»¶éªŒè¯æˆåŠŸ"
else
    echo "âŒ å¤‡ä»½æ–‡ä»¶éªŒè¯å¤±è´¥"
    exit 1
fi

# 3. æµ‹è¯•æ¢å¤æ—¶é—´
echo "æµ‹è¯•æ¢å¤æ€§èƒ½..."
start_time=$(date +%s)
# åœ¨æµ‹è¯•ç¯å¢ƒæ¢å¤
restore_to_test_env.sh
end_time=$(date +%s)
echo "é¢„è®¡æ¢å¤æ—¶é—´: $((end_time - start_time))ç§’"
```

### 8.4 å‡çº§å½±å“æœ€å°åŒ–


**ğŸ”§ æœ€å°åŒ–å½±å“ç­–ç•¥**
```
æ—¶é—´çª—å£é€‰æ‹©ï¼š
â€¢ ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ
â€¢ é¿å¼€é‡è¦æ´»åŠ¨æ—¶é—´
â€¢ é¢„ç•™è¶³å¤Ÿæ—¶é—´buffer

åˆ†é˜¶æ®µå‡çº§ï¼š
â€¢ æµ‹è¯•ç¯å¢ƒå…ˆè¡ŒéªŒè¯
â€¢ ç°åº¦ç¯å¢ƒå°æµé‡æµ‹è¯•  
â€¢ ç”Ÿäº§ç¯å¢ƒæ­£å¼å‡çº§

ç›‘æ§å‘Šè­¦ï¼š
â€¢ å‡çº§å‰åŠ å¼ºç›‘æ§
â€¢ è®¾ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦
â€¢ å‡†å¤‡å¿«é€Ÿå“åº”å›¢é˜Ÿ
```

**ğŸ“Š å‡çº§åæ€§èƒ½éªŒè¯**
```sql
-- å…³é”®æ€§èƒ½æŒ‡æ ‡æ£€æŸ¥

-- 1. æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”
SELECT 
    event_name,
    count_star,
    avg_timer_wait/1000000000 as avg_time_ms
FROM performance_schema.events_statements_summary_global_by_event_name 
WHERE event_name LIKE 'statement/sql/select'
ORDER BY avg_timer_wait DESC LIMIT 10;

-- 2. è¿æ¥æ•°ç›‘æ§
SHOW STATUS LIKE 'Threads_connected';
SHOW STATUS LIKE 'Max_used_connections';

-- 3. InnoDBçŠ¶æ€æ£€æŸ¥
SHOW ENGINE INNODB STATUS;
```

### 8.5 å‡çº§å·¥å…·ä½¿ç”¨


**ğŸ› ï¸ å®˜æ–¹å‡çº§å·¥å…·**
```bash
# mysql_upgrade - MySQLå®˜æ–¹å‡çº§å·¥å…·
mysql_upgrade [options]

# å¸¸ç”¨å‚æ•°
mysql_upgrade --user=root --password
mysql_upgrade --upgrade-system-tables  # ä»…å‡çº§ç³»ç»Ÿè¡¨
mysql_upgrade --write-binlog           # å†™å…¥binlog
mysql_upgrade --skip-verbose           # å‡å°‘è¾“å‡ºä¿¡æ¯
```

**ğŸ”§ ç¬¬ä¸‰æ–¹å‡çº§å·¥å…·**
```bash
# pt-upgrade - Perconaå·¥å…·åŒ…
# ç”¨äºå‡çº§å‰çš„æŸ¥è¯¢å…¼å®¹æ€§æµ‹è¯•
pt-upgrade --source-dsn h=old_server --target-dsn h=new_server slow.log

# MySQL Shellå‡çº§æ£€æŸ¥å·¥å…·
mysqlsh --js -e "util.checkForServerUpgrade('root@localhost:3306')"
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å‡çº§æ•…éšœæœ¬è´¨ï¼šç‰ˆæœ¬å·®å¼‚å¯¼è‡´çš„å…¼å®¹æ€§é—®é¢˜
ğŸ”¸ æ•…éšœåˆ†ç±»ï¼šå‡çº§å‰ã€å‡çº§ä¸­ã€å‡çº§åä¸‰ä¸ªé˜¶æ®µ
ğŸ”¸ å…³é”®ç»„ä»¶ï¼šæ•°æ®å­—å…¸ã€é…ç½®å‚æ•°ã€è®¤è¯æ–¹å¼
ğŸ”¸ é£é™©æ§åˆ¶ï¼šå¤‡ä»½éªŒè¯ã€æ»šåŠ¨å‡çº§ã€å¿«é€Ÿå›æ»š
ğŸ”¸ å½±å“æœ€å°åŒ–ï¼šé€‰æ‹©åˆé€‚æ—¶é—´çª—å£ã€åˆ†é˜¶æ®µå®æ–½
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆå‡çº§ä¼šå¤±è´¥**
```
æ ¹æœ¬åŸå› ï¼š
â€¢ MySQLå„ç‰ˆæœ¬é—´å­˜åœ¨ä¸å…¼å®¹å˜æ›´
â€¢ æ•°æ®å­—å…¸ç»“æ„å‘ç”Ÿé‡å¤§æ”¹å˜
â€¢ SQLæ ‡å‡†å®ç°æ›´åŠ ä¸¥æ ¼
â€¢ é»˜è®¤é…ç½®å’Œè¡Œä¸ºå·®å¼‚

é¢„é˜²åŸåˆ™ï¼š
â€¢ å……åˆ†çš„å…¼å®¹æ€§æµ‹è¯•
â€¢ å®Œæ•´çš„å¤‡ä»½éªŒè¯
â€¢ è¯¦ç»†çš„å›æ»šé¢„æ¡ˆ
â€¢ åˆ†é˜¶æ®µé£é™©æ§åˆ¶
```

**ğŸ”¹ å‡çº§ç­–ç•¥é€‰æ‹©**
```
å•æœºå‡çº§ï¼š
â€¢ é€‚ç”¨äºå¯æ¥å—åœæœºçš„åœºæ™¯
â€¢ æ“ä½œç®€å•ï¼Œé£é™©ç›¸å¯¹å¯æ§
â€¢ éœ€è¦å‡†å¤‡å®Œæ•´å›æ»šæ–¹æ¡ˆ

æ»šåŠ¨å‡çº§ï¼š
â€¢ é€‚ç”¨äºé«˜å¯ç”¨è¦æ±‚åœºæ™¯
â€¢ å¤æ‚åº¦é«˜ï¼Œéœ€è¦é›†ç¾¤æ”¯æŒ
â€¢ å¯ä»¥å®ç°è¿‘é›¶åœæœºå‡çº§

ç°åº¦å‡çº§ï¼š
â€¢ é€‚ç”¨äºå¤§å‹ç”Ÿäº§ç¯å¢ƒ
â€¢ é€æ­¥éªŒè¯ï¼Œé£é™©æœ€å°
â€¢ éœ€è¦å®Œå–„çš„ç›‘æ§ä½“ç³»
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å‡çº§å‰å‡†å¤‡checklist**
```
ç¯å¢ƒå‡†å¤‡ï¼š
â–¡ æµ‹è¯•ç¯å¢ƒéªŒè¯é€šè¿‡
â–¡ å¤‡ä»½æ–‡ä»¶éªŒè¯å®Œæ•´
â–¡ å›æ»šæ–¹æ¡ˆå‡†å¤‡å°±ç»ª
â–¡ ç›‘æ§å‘Šè­¦é…ç½®å®Œæˆ

å›¢é˜Ÿå‡†å¤‡ï¼š
â–¡ DBAå›¢é˜Ÿç°åœºå¾…å‘½
â–¡ åº”ç”¨å›¢é˜ŸåŒæ­¥åœ¨çº¿
â–¡ ä¸šåŠ¡æ–¹ç¡®è®¤æ—¶é—´çª—å£
â–¡ è¿ç»´å›¢é˜Ÿæ”¯æŒå°±ç»ª
```

**ğŸ”§ æ•…éšœå¤„ç†ä¼˜å…ˆçº§**
```
P0 - æ•°æ®åº“æ— æ³•å¯åŠ¨ï¼š
â€¢ ç«‹å³å¯åŠ¨å›æ»šæµç¨‹
â€¢ é€šçŸ¥ç›¸å…³å›¢é˜Ÿ
â€¢ åˆ†ææ ¹å› ï¼Œåˆ¶å®šä¿®å¤æ–¹æ¡ˆ

P1 - å…³é”®åŠŸèƒ½å¼‚å¸¸ï¼š
â€¢ è¯„ä¼°ä¸šåŠ¡å½±å“èŒƒå›´
â€¢ 2å°æ—¶å†…ç»™å‡ºå¤„ç†æ–¹æ¡ˆ
â€¢ å¿…è¦æ—¶æ‰§è¡Œå›æ»š

P2 - æ€§èƒ½æˆ–å…¼å®¹æ€§é—®é¢˜ï¼š
â€¢ ç›‘æ§å…³é”®æŒ‡æ ‡å˜åŒ–
â€¢ åº”ç”¨å±‚ä¸´æ—¶è§„é¿
â€¢ åˆ¶å®šä¼˜åŒ–æ”¹è¿›è®¡åˆ’
```

**ğŸ’¡ ç»éªŒæ€»ç»“**
```
æˆåŠŸå‡çº§çš„å…³é”®å› ç´ ï¼š
â€¢ å……åˆ†çš„æµ‹è¯•éªŒè¯ (70%çš„å·¥ä½œé‡)
â€¢ å®Œæ•´çš„å¤‡ä»½ç­–ç•¥ (ä¿åº•æ–¹æ¡ˆ)
â€¢ æ¸…æ™°çš„è´£ä»»åˆ†å·¥ (é¿å…æ··ä¹±)
â€¢ å¿«é€Ÿçš„å†³ç­–æœºåˆ¶ (å‡å°‘æŸå¤±)

å¸¸è§å¤±è´¥åŸå› ï¼š
â€¢ å…¼å®¹æ€§æµ‹è¯•ä¸å……åˆ†
â€¢ å¤‡ä»½éªŒè¯å­˜åœ¨æ¼æ´
â€¢ å›æ»šæ–¹æ¡ˆä¸å®Œæ•´
â€¢ æ²Ÿé€šåè°ƒä¸åˆ°ä½
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- MySQLå‡çº§é£é™©é«˜ï¼Œå……åˆ†å‡†å¤‡æ˜¯å…³é”®
- å…¼å®¹æ€§é—®é¢˜æœ€å¸¸è§ï¼Œç‰ˆæœ¬å·®å¼‚è¦é‡è§†
- æ•°æ®å­—å…¸æ˜¯æ ¸å¿ƒï¼Œå‡çº§å¤±è´¥å½±å“å¤§  
- æ»šåŠ¨å‡çº§ä¿å¯ç”¨ï¼Œå›æ»šé¢„æ¡ˆè¦å®Œæ•´
- å·¥å…·è¾…åŠ©ææ•ˆç‡ï¼Œäººå·¥éªŒè¯ä¿è´¨é‡