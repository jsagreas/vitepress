---
title: 34ã€æ—¶åŒºé—®é¢˜æ•…éšœæ¡ˆä¾‹
---
## ğŸ“š ç›®å½•

1. [æ—¶åŒºé—®é¢˜åŸºç¡€æ¦‚å¿µ](#1-æ—¶åŒºé—®é¢˜åŸºç¡€æ¦‚å¿µ)
2. [å¸¸è§æ—¶åŒºæ•…éšœç±»å‹](#2-å¸¸è§æ—¶åŒºæ•…éšœç±»å‹)
3. [ç³»ç»Ÿæ—¶åŒºvsæ•°æ®åº“æ—¶åŒº](#3-ç³»ç»Ÿæ—¶åŒºvsæ•°æ®åº“æ—¶åŒº)
4. [å…¸å‹æ•…éšœæ¡ˆä¾‹åˆ†æ](#4-å…¸å‹æ•…éšœæ¡ˆä¾‹åˆ†æ)
5. [æ—¶åŒºé—®é¢˜æ’æŸ¥æ–¹æ³•](#5-æ—¶åŒºé—®é¢˜æ’æŸ¥æ–¹æ³•)
6. [æ—¶åŒºé…ç½®æœ€ä½³å®è·µ](#6-æ—¶åŒºé…ç½®æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ æ—¶åŒºé—®é¢˜åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ—¶åŒºé—®é¢˜


**ğŸ”¸ ç®€å•ç†è§£**
æ—¶åŒºé—®é¢˜å°±åƒä¸åŒåœ°åŒºçš„äººçº¦ä¼šæ—¶æé”™äº†æ—¶é—´ä¸€æ ·ã€‚æ¯”å¦‚åŒ—äº¬æ—¶é—´8ç‚¹å¼€ä¼šï¼Œå¦‚æœç¾å›½åŒäº‹æŒ‰ç…§å½“åœ°æ—¶é—´ç†è§£ï¼Œå°±ä¼šè¿Ÿåˆ°12ä¸ªå°æ—¶ï¼

**ğŸ”¸ æ•°æ®åº“ä¸­çš„æ—¶åŒº**
```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
å…¨çƒå…¬å¸ â†’ å¤šæ—¶åŒºMySQLéƒ¨ç½²
åŒ—äº¬åŠå…¬å®¤ â†’ Asia/Shanghaiæ—¶åŒº
çº½çº¦åŠå…¬å®¤ â†’ America/New_Yorkæ—¶åŒº
ä¼¦æ•¦åŠå…¬å®¤ â†’ Europe/Londonæ—¶åŒº

é—®é¢˜ï¼šåŒä¸€æ¡æ•°æ®åœ¨ä¸åŒåœ°åŒºæ˜¾ç¤ºçš„æ—¶é—´ä¸ä¸€æ ·ï¼
```

### 1.2 MySQLæ—¶åŒºæœºåˆ¶è¯¦è§£


**ğŸ’¡ MySQLçš„æ—¶åŒºå¤„ç†æ–¹å¼**
```sql
-- MySQLæœ‰ä¸¤ä¸ªé‡è¦çš„æ—¶åŒºè®¾ç½®
SHOW VARIABLES LIKE '%time_zone%';

-- ç»“æœç¤ºä¾‹ï¼š
-- system_time_zone: CST      (æœåŠ¡å™¨ç³»ç»Ÿæ—¶åŒº)
-- time_zone: SYSTEM          (MySQLä½¿ç”¨çš„æ—¶åŒº)
```

**ğŸ” æ—¶åŒºå­˜å‚¨åŸç†**
```
ç”¨æˆ·è¾“å…¥: '2024-01-01 10:00:00'
MySQLå†…éƒ¨å­˜å‚¨è¿‡ç¨‹ï¼š
1. æ ¹æ®å½“å‰time_zoneè®¾ç½®è§£ææ—¶é—´
2. è½¬æ¢ä¸ºUTCæ—¶é—´å­˜å‚¨
3. æŸ¥è¯¢æ—¶å†è½¬æ¢å›å½“å‰time_zoneæ˜¾ç¤º

ä¸¾ä¾‹ï¼š
è¾“å…¥æ—¶é—´: 2024-01-01 10:00:00 (Asia/Shanghai)
å†…éƒ¨å­˜å‚¨: 2024-01-01 02:00:00 (UTC)
ç¾å›½æŸ¥è¯¢: 2023-12-31 21:00:00 (America/New_York)
```

### 1.3 æ—¶åŒºé—®é¢˜çš„æ ¹æœ¬åŸå› 


**âš ï¸ å¸¸è§åŸå› åˆ†æ**
```
ğŸ”¸ é…ç½®ä¸ä¸€è‡´
- åº”ç”¨æœåŠ¡å™¨æ—¶åŒº: Asia/Shanghai  
- æ•°æ®åº“æœåŠ¡å™¨æ—¶åŒº: UTC
- ç»“æœ: æ—¶é—´ç›¸å·®8å°æ—¶

ğŸ”¸ å¤ä»¤æ—¶åˆ‡æ¢
- ç¾å›½æ¯å¹´3æœˆå’Œ11æœˆè°ƒæ•´æ—¶é—´
- å¦‚æœç³»ç»Ÿæ²¡æœ‰æ­£ç¡®å¤„ç†ï¼Œä¼šå‡ºç°1å°æ—¶åå·®

ğŸ”¸ æ•°æ®è¿ç§»é—®é¢˜
- ä»ä¸€ä¸ªæ—¶åŒºçš„æ•°æ®åº“è¿ç§»åˆ°å¦ä¸€ä¸ªæ—¶åŒº
- æ—¶é—´æˆ³æ•°æ®å¯èƒ½æ˜¾ç¤ºé”™è¯¯
```

---

## 2. âš¡ å¸¸è§æ—¶åŒºæ•…éšœç±»å‹


### 2.1 æ—¶é—´æˆ³æ˜¾ç¤ºé”™è¯¯


**ğŸ“‹ æ•…éšœç°è±¡**
```
ç”¨æˆ·åé¦ˆï¼š
"æˆ‘æ˜æ˜ä¸‹åˆ2ç‚¹ä¸‹çš„è®¢å•ï¼Œä¸ºä»€ä¹ˆç³»ç»Ÿæ˜¾ç¤ºæ˜¯å‡Œæ™¨6ç‚¹ï¼Ÿ"

æŠ€æœ¯è¡¨ç°ï¼š
- ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºæ—¶é—´ä¸å®é™…æ“ä½œæ—¶é—´ä¸ç¬¦
- åŒä¸€æ¡è®°å½•åœ¨ä¸åŒç³»ç»Ÿä¸­æ˜¾ç¤ºæ—¶é—´ä¸ä¸€è‡´
- æ—¥å¿—æ—¶é—´å’Œæ•°æ®åº“æ—¶é—´å¯¹ä¸ä¸Š
```

**ğŸ”§ æ•…éšœåŸå› **
```sql
-- åº”ç”¨æœåŠ¡å™¨é…ç½®
åº”ç”¨æ—¶åŒº: Asia/Shanghai (+8)

-- MySQLé…ç½®  
SELECT $$time_zone;  -- ç»“æœ: '+00:00' (UTC)

-- é—®é¢˜: åº”ç”¨æŒ‰åŒ—äº¬æ—¶é—´å­˜å‚¨ï¼Œæ•°æ®åº“æŒ‰UTCç†è§£
-- ç»“æœ: æ—¶é—´ç›¸å·®8å°æ—¶
```

### 2.2 è·¨æ—¶åŒºæ•°æ®åŒæ­¥å¼‚å¸¸


**ğŸ“‹ æ•…éšœç°è±¡**
```
åœºæ™¯: åŒ—äº¬æ€»éƒ¨æ•°æ®åŒæ­¥åˆ°ç¾å›½åˆ†å…¬å¸
é—®é¢˜: åŒæ­¥åæ‰€æœ‰æ—¶é—´éƒ½æå‰äº†13å°æ—¶

åŸå› åˆ†æï¼š
åŒ—äº¬æœåŠ¡å™¨: Asia/Shanghai (+8)
ç¾å›½æœåŠ¡å™¨: America/New_York (-5)
æ—¶å·®: 13å°æ—¶

åŒæ­¥è¿‡ç¨‹ä¸­æ—¶åŒºè½¬æ¢é”™è¯¯å¯¼è‡´æ—¶é—´åç§»
```

**ğŸ’» é—®é¢˜å¤ç°ä»£ç **
```sql
-- åŒ—äº¬æœåŠ¡å™¨æ‰§è¡Œ
SET time_zone = 'Asia/Shanghai';
INSERT INTO orders (order_time) VALUES ('2024-01-01 14:00:00');

-- æ•°æ®åŒæ­¥åˆ°ç¾å›½æœåŠ¡å™¨å
SET time_zone = 'America/New_York';
SELECT order_time FROM orders;
-- æ˜¾ç¤º: 2024-01-01 01:00:00 (é”™è¯¯!)
-- åº”è¯¥: 2024-01-01 01:00:00 ä½†è¿™æ˜¯çº½çº¦å½“åœ°æ—¶é—´ï¼Œå¯¹åº”åŒ—äº¬14:00
```

### 2.3 å¤ä»¤æ—¶åˆ‡æ¢é—®é¢˜


**ğŸ“… å¤ä»¤æ—¶åŸºç¡€çŸ¥è¯†**
```
å¤ä»¤æ—¶è§„åˆ™ (ç¾å›½ä¸ºä¾‹):
æ˜¥å­£: 3æœˆç¬¬äºŒä¸ªæ˜ŸæœŸæ—¥ 2:00 AM â†’ 3:00 AM (è·³è¿‡1å°æ—¶)
ç§‹å­£: 11æœˆç¬¬ä¸€ä¸ªæ˜ŸæœŸæ—¥ 2:00 AM â†’ 1:00 AM (é‡å¤1å°æ—¶)

æ•°æ®åº“å½±å“:
- æ˜¥å­£åˆ‡æ¢: 02:00-02:59è¿™1å°æ—¶ä¸å­˜åœ¨
- ç§‹å­£åˆ‡æ¢: 01:00-01:59è¿™1å°æ—¶å‡ºç°ä¸¤æ¬¡
```

**ğŸš¨ å…¸å‹æ•…éšœæ¡ˆä¾‹**
```sql
-- å¤ä»¤æ—¶åˆ‡æ¢å½“å¤©çš„æ•°æ®å¼‚å¸¸
-- 2024å¹´3æœˆ10æ—¥ (ç¾å›½å¤ä»¤æ—¶å¼€å§‹)

-- å°è¯•æ’å…¥ä¸å­˜åœ¨çš„æ—¶é—´
SET time_zone = 'America/New_York';
INSERT INTO events (event_time) 
VALUES ('2024-03-10 02:30:00');  -- è¿™ä¸ªæ—¶é—´ä¸å­˜åœ¨!

-- MySQLçš„å¤„ç†æ–¹å¼å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
```

---

## 3. ğŸ”„ ç³»ç»Ÿæ—¶åŒºvsæ•°æ®åº“æ—¶åŒº


### 3.1 æ—¶åŒºå±‚çº§å…³ç³»


**ğŸ—ï¸ æ—¶åŒºè®¾ç½®çš„å±‚çº§ç»“æ„**
```
æ“ä½œç³»ç»Ÿæ—¶åŒº
    â†“
MySQLæœåŠ¡å™¨æ—¶åŒº (system_time_zone)
    â†“  
MySQLä¼šè¯æ—¶åŒº (time_zone)
    â†“
åº”ç”¨ç¨‹åºæ—¶åŒº
    â†“
ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºæ—¶åŒº
```

### 3.2 å„å±‚çº§æ—¶åŒºçš„ä½œç”¨


**ğŸ“Š æ—¶åŒºå±‚çº§è¯¦è§£**

| å±‚çº§ | ä½œç”¨èŒƒå›´ | è®¾ç½®æ–¹æ³• | å½±å“ç¨‹åº¦ |
|------|----------|----------|----------|
| **ç³»ç»Ÿæ—¶åŒº** | æ•´ä¸ªæœåŠ¡å™¨ | `timedatectl set-timezone` | ğŸ”´ å…¨å±€å½±å“ |
| **MySQLæœåŠ¡å™¨æ—¶åŒº** | MySQLå®ä¾‹ | `my.cnf`é…ç½® | ğŸŸ¡ å®ä¾‹çº§åˆ« |
| **ä¼šè¯æ—¶åŒº** | å•ä¸ªè¿æ¥ | `SET time_zone` | ğŸŸ¢ ä¼šè¯çº§åˆ« |
| **åº”ç”¨æ—¶åŒº** | åº”ç”¨ç¨‹åº | ä»£ç ä¸­è®¾ç½® | ğŸŸ¢ åº”ç”¨çº§åˆ« |

### 3.3 æ—¶åŒºå†²çªåœºæ™¯


**âš ï¸ å¸¸è§å†²çªæƒ…å†µ**
```bash
# æœåŠ¡å™¨ç³»ç»Ÿæ—¶åŒº
$ timedatectl
Time zone: Asia/Shanghai (CST, +0800)

# MySQLé…ç½®
mysql> SELECT $$system_time_zone, $$time_zone;
+------------------+-----------+
| $$system_time_zone | $$time_zone |
+------------------+-----------+
| CST              | +00:00    |  â† å†²çªç‚¹
+------------------+-----------+

# åº”ç”¨ç¨‹åº
Javaåº”ç”¨æ—¶åŒº: UTC
PHPåº”ç”¨æ—¶åŒº: Asia/Shanghai

# ç»“æœ: å››ä¸ªä¸åŒçš„æ—¶åŒºè®¾ç½®!
```

---

## 4. ğŸ“ å…¸å‹æ•…éšœæ¡ˆä¾‹åˆ†æ


### 4.1 æ¡ˆä¾‹ä¸€ï¼šç”µå•†è®¢å•æ—¶é—´é”™ä¹±


**ğŸ›’ æ•…éšœèƒŒæ™¯**
```
ç³»ç»Ÿç¯å¢ƒï¼š
- ç”µå•†å¹³å°ï¼Œæ€»éƒ¨åœ¨ä¸Šæµ·
- æ•°æ®åº“æœåŠ¡å™¨: é˜¿é‡Œäº‘ECS (Asia/Shanghai)
- åº”ç”¨æœåŠ¡å™¨: AWS EC2 (UTCé»˜è®¤)
- CDN: CloudFlare (å…¨çƒåˆ†å¸ƒ)

æ•…éšœç°è±¡ï¼š
ç”¨æˆ·åé¦ˆè®¢å•æ—¶é—´æ˜¾ç¤ºæ··ä¹±ï¼Œå®¢æœæ— æ³•å‡†ç¡®è·Ÿè¸ªè®¢å•çŠ¶æ€
```

**ğŸ” é—®é¢˜æ’æŸ¥è¿‡ç¨‹**
```sql
-- 1. æ£€æŸ¥æ•°æ®åº“æ—¶åŒºè®¾ç½®
mysql> SELECT $$time_zone, $$system_time_zone;
+-------------+------------------+
| $$time_zone | $$system_time_zone |
+-------------+------------------+
| SYSTEM      | CST              |
+-------------+------------------+

-- 2. æ£€æŸ¥è®¢å•è¡¨æ•°æ®
mysql> SELECT order_id, order_time, 
              CONVERT_TZ(order_time, '+08:00', '+00:00') as utc_time
       FROM orders 
       WHERE order_id = 12345;
+----------+---------------------+---------------------+
| order_id | order_time          | utc_time            |
+----------+---------------------+---------------------+
|    12345 | 2024-01-01 14:00:00 | 2024-01-01 06:00:00 |
+----------+---------------------+---------------------+

-- 3. å‘ç°é—®é¢˜ï¼šåº”ç”¨æœåŠ¡å™¨æŒ‰UTCå­˜å‚¨ï¼Œæ•°æ®åº“æŒ‰CSTæ˜¾ç¤º
```

**âœ… è§£å†³æ–¹æ¡ˆ**
```sql
-- æ–¹æ¡ˆ1: ç»Ÿä¸€æ•°æ®åº“æ—¶åŒºä¸ºUTC
SET GLOBAL time_zone = '+00:00';

-- æ–¹æ¡ˆ2: åº”ç”¨å±‚ç»Ÿä¸€å¤„ç†æ—¶åŒº
-- Javaä»£ç ç¤ºä¾‹
TimeZone.setDefault(TimeZone.getTimeZone("Asia/Shanghai"));

-- æ–¹æ¡ˆ3: å­˜å‚¨æ—¶æ˜ç¡®æŒ‡å®šæ—¶åŒº
INSERT INTO orders (order_time) 
VALUES (CONVERT_TZ('2024-01-01 14:00:00', '+08:00', '+00:00'));
```

### 4.2 æ¡ˆä¾‹äºŒï¼šè·¨å›½å…¬å¸æ•°æ®åŒæ­¥é—®é¢˜


**ğŸŒ æ•…éšœèƒŒæ™¯**
```
å…¬å¸æ¶æ„ï¼š
- æ€»éƒ¨: ä¸­å›½åŒ—äº¬ (Asia/Shanghai)  
- åˆ†å…¬å¸: ç¾å›½çº½çº¦ (America/New_York)
- åˆ†å…¬å¸: è‹±å›½ä¼¦æ•¦ (Europe/London)

æ•°æ®åŒæ­¥éœ€æ±‚ï¼š
æ¯å¤©å‡Œæ™¨1ç‚¹(å„åœ°æœ¬åœ°æ—¶é—´)è¿›è¡Œæ•°æ®åŒæ­¥
```

**âŒ é—®é¢˜ç°è±¡**
```
åŒæ­¥æ—¶é—´æ··ä¹±ï¼š
- åŒ—äº¬: 01:00 æ‰§è¡ŒåŒæ­¥ âœ“
- çº½çº¦: 01:00 æ‰§è¡ŒåŒæ­¥ï¼Œä½†æ•°æ®æ—¶é—´æˆ³æ˜¾ç¤ºä¸ºåŒ—äº¬æ—¶é—´14:00 âœ—  
- ä¼¦æ•¦: 01:00 æ‰§è¡ŒåŒæ­¥ï¼Œä½†æ•°æ®æ—¶é—´æˆ³æ˜¾ç¤ºä¸ºåŒ—äº¬æ—¶é—´08:00 âœ—

ç»“æœ: æŠ¥è¡¨æ•°æ®æ—¶é—´é¡ºåºæ··ä¹±ï¼Œä¸šåŠ¡åˆ†æé”™è¯¯
```

**ğŸ”§ æ’æŸ¥å’Œè§£å†³**
```sql
-- é—®é¢˜è¯Šæ–­æŸ¥è¯¢
SELECT 
    server_location,
    local_sync_time,
    CONVERT_TZ(local_sync_time, $$time_zone, 'UTC') AS utc_sync_time,
    CONVERT_TZ(local_sync_time, $$time_zone, 'Asia/Shanghai') AS beijing_time
FROM sync_log;

-- æ ‡å‡†åŒ–è§£å†³æ–¹æ¡ˆ
-- 1. æ‰€æœ‰æœåŠ¡å™¨ç»Ÿä¸€ä½¿ç”¨UTCå­˜å‚¨
SET GLOBAL time_zone = '+00:00';

-- 2. åº”ç”¨ç¨‹åºå¤„ç†æ—¶åŒºè½¬æ¢
-- Pythonç¤ºä¾‹
import pytz
from datetime import datetime

def store_sync_time():
    # è·å–æœ¬åœ°æ—¶é—´
    local_tz = pytz.timezone('America/New_York')  # æ ¹æ®æœåŠ¡å™¨ä½ç½®è®¾ç½®
    local_time = local_tz.localize(datetime.now())
    
    # è½¬æ¢ä¸ºUTCå­˜å‚¨
    utc_time = local_time.astimezone(pytz.UTC)
    
    # å­˜å‚¨åˆ°æ•°æ®åº“
    query = "INSERT INTO sync_log (sync_time) VALUES (%s)"
    cursor.execute(query, (utc_time,))
```

### 4.3 æ¡ˆä¾‹ä¸‰ï¼šå¤ä»¤æ—¶å¯¼è‡´çš„å®šæ—¶ä»»åŠ¡å¼‚å¸¸


**â° æ•…éšœèƒŒæ™¯**
```
å®šæ—¶ä»»åŠ¡é…ç½®ï¼š
- æ¯å¤©å‡Œæ™¨2:00æ‰§è¡Œæ•°æ®å¤‡ä»½
- æœåŠ¡å™¨ä½ç½®ï¼šç¾å›½ä¸œéƒ¨ (America/New_York)
- ä»»åŠ¡è°ƒåº¦ï¼šcrontab + MySQLäº‹ä»¶è°ƒåº¦å™¨

æ•…éšœæ—¶é—´ï¼š2024å¹´3æœˆ10æ—¥ (å¤ä»¤æ—¶å¼€å§‹)
```

**ğŸš¨ æ•…éšœç°è±¡**
```
å¤ä»¤æ—¶åˆ‡æ¢å½“å¤©ï¼š
- 02:00 AM â†’ 03:00 AM (è·³è¿‡1å°æ—¶)
- å®šæ—¶ä»»åŠ¡åœ¨2:00æ‰§è¡Œï¼Œä½†è¿™ä¸ªæ—¶é—´ä¸å­˜åœ¨
- ç»“æœï¼šå¤‡ä»½ä»»åŠ¡è·³è¿‡ï¼Œæ•°æ®ä¸¢å¤±é£é™©

MySQLäº‹ä»¶è°ƒåº¦å™¨é”™è¯¯ï¼š
ERROR: Incorrect datetime value for 'scheduled_time'
```

**âœ… è§£å†³æ–¹æ¡ˆ**
```sql
-- 1. ä¿®æ”¹äº‹ä»¶è°ƒåº¦å™¨ä¸ºUTCæ—¶åŒº
SET GLOBAL time_zone = '+00:00';
SET GLOBAL event_scheduler = ON;

-- 2. é‡æ–°åˆ›å»ºäº‹ä»¶ (UTCæ—¶é—´)
DROP EVENT IF EXISTS daily_backup;

CREATE EVENT daily_backup
ON SCHEDULE EVERY 1 DAY 
STARTS '2024-01-01 06:00:00'  -- UTC 06:00 = ç¾ä¸œ 01:00(æ ‡å‡†æ—¶é—´)
DO
BEGIN
    -- æ‰§è¡Œå¤‡ä»½é€»è¾‘
    INSERT INTO backup_log (backup_time, status) 
    VALUES (UTC_TIMESTAMP(), 'started');
    
    -- å¤‡ä»½æ“ä½œ...
END;

-- 3. crontabä¹Ÿæ”¹ç”¨UTCæ—¶é—´
-- crontab -e
-- 0 6 * * * /path/to/backup.sh  # UTC 06:00
```

---

## 5. ğŸ” æ—¶åŒºé—®é¢˜æ’æŸ¥æ–¹æ³•


### 5.1 ç³»ç»Ÿçº§æ’æŸ¥


**ğŸ–¥ï¸ æœåŠ¡å™¨æ—¶åŒºæ£€æŸ¥**
```bash
# 1. æŸ¥çœ‹ç³»ç»Ÿæ—¶åŒº
timedatectl

# è¾“å‡ºç¤ºä¾‹:
#       Local time: Mon 2024-01-01 14:00:00 CST
#   Universal time: Mon 2024-01-01 06:00:00 UTC  
#         RTC time: Mon 2024-01-01 06:00:00
#        Time zone: Asia/Shanghai (CST, +0800)

# 2. æŸ¥çœ‹æ—¶åŒºæ–‡ä»¶
ls -la /etc/localtime
cat /etc/timezone  # Ubuntu/Debian
cat /etc/sysconfig/clock  # CentOS/RHEL

# 3. æŸ¥çœ‹ç¯å¢ƒå˜é‡
echo $TZ
```

### 5.2 MySQLçº§æ’æŸ¥


**ğŸ”§ æ•°æ®åº“æ—¶åŒºè¯Šæ–­**
```sql
-- 1. åŸºç¡€æ—¶åŒºä¿¡æ¯
SELECT 
    $$system_time_zone AS 'ç³»ç»Ÿæ—¶åŒº',
    $$time_zone AS 'ä¼šè¯æ—¶åŒº',
    NOW() AS 'å½“å‰æ—¶é—´',
    UTC_TIMESTAMP() AS 'UTCæ—¶é—´';

-- 2. æ£€æŸ¥æ—¶åŒºè¡¨æ˜¯å¦åŠ è½½
SELECT COUNT(*) FROM mysql.time_zone;
-- å¦‚æœç»“æœä¸º0ï¼Œè¯´æ˜æ—¶åŒºè¡¨æœªåˆå§‹åŒ–

-- 3. æµ‹è¯•æ—¶åŒºè½¬æ¢
SELECT 
    '2024-01-01 12:00:00' AS 'åŸå§‹æ—¶é—´',
    CONVERT_TZ('2024-01-01 12:00:00', 'Asia/Shanghai', 'UTC') AS 'è½¬æ¢ä¸ºUTC',
    CONVERT_TZ('2024-01-01 12:00:00', 'UTC', 'America/New_York') AS 'è½¬æ¢ä¸ºçº½çº¦æ—¶é—´';
```

### 5.3 åº”ç”¨çº§æ’æŸ¥


**ğŸ’» åº”ç”¨ç¨‹åºæ—¶åŒºæ£€æŸ¥**
```java
// Javaåº”ç”¨æ£€æŸ¥
public class TimezoneDebug {
    public static void main(String[] args) {
        // 1. JVMé»˜è®¤æ—¶åŒº
        System.out.println("JVMæ—¶åŒº: " + TimeZone.getDefault().getID());
        
        // 2. ç³»ç»Ÿå±æ€§
        System.out.println("user.timezone: " + System.getProperty("user.timezone"));
        
        // 3. å½“å‰æ—¶é—´å„æ—¶åŒºæ˜¾ç¤º
        LocalDateTime now = LocalDateTime.now();
        System.out.println("æœ¬åœ°æ—¶é—´: " + now);
        
        ZonedDateTime utc = now.atZone(ZoneId.of("UTC"));
        System.out.println("UTCæ—¶é—´: " + utc);
        
        ZonedDateTime shanghai = now.atZone(ZoneId.of("Asia/Shanghai"));
        System.out.println("ä¸Šæµ·æ—¶é—´: " + shanghai);
    }
}
```

### 5.4 å®Œæ•´æ’æŸ¥æ¸…å•


**ğŸ“‹ æ—¶åŒºé—®é¢˜æ’æŸ¥æ­¥éª¤**

```
âœ… ç¬¬ä¸€æ­¥ï¼šæ”¶é›†åŸºç¡€ä¿¡æ¯
- [ ] æœåŠ¡å™¨æ“ä½œç³»ç»Ÿæ—¶åŒºè®¾ç½®
- [ ] MySQLæ—¶åŒºé…ç½® (system_time_zone, time_zone)
- [ ] åº”ç”¨ç¨‹åºæ—¶åŒºè®¾ç½®
- [ ] ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºæ—¶åŒº

âœ… ç¬¬äºŒæ­¥ï¼šå¯¹æ¯”æ—¶é—´ä¸€è‡´æ€§  
- [ ] ç³»ç»Ÿæ—¶é—´ vs MySQLæ—¶é—´
- [ ] MySQLå­˜å‚¨æ—¶é—´ vs åº”ç”¨æ˜¾ç¤ºæ—¶é—´
- [ ] ä¸åŒæœåŠ¡å™¨é—´æ—¶é—´åŒæ­¥çŠ¶æ€

âœ… ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•æ—¶åŒºè½¬æ¢
- [ ] CONVERT_TZå‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ
- [ ] å¤ä»¤æ—¶åˆ‡æ¢æ˜¯å¦æ­£ç¡®å¤„ç†
- [ ] è·¨æ—¶åŒºæ•°æ®ä¼ è¾“æ˜¯å¦ä¸€è‡´

âœ… ç¬¬å››æ­¥ï¼šæ£€æŸ¥å†å²æ•°æ®
- [ ] æ—¶åŒºæ›´æ”¹å‰åçš„æ•°æ®ä¸€è‡´æ€§
- [ ] å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´è®°å½•
- [ ] ç”¨æˆ·æ“ä½œæ—¶é—´æˆ³å‡†ç¡®æ€§
```

---

## 6. ğŸ› ï¸ æ—¶åŒºé…ç½®æœ€ä½³å®è·µ


### 6.1 æ ‡å‡†åŒ–æ—¶åŒºé…ç½®


**ğŸ¯ æ¨èé…ç½®ç­–ç•¥**

**æ–¹æ¡ˆä¸€ï¼šå…¨UTCç­–ç•¥ (æ¨è)**
```sql
-- 1. MySQLæœåŠ¡å™¨é…ç½®
# my.cnf
[mysqld]
default-time-zone = '+00:00'
log_timestamps = UTC

-- 2. åº”ç”¨ç¨‹åºé…ç½®
# Java
-Duser.timezone=UTC

# PHP
date_default_timezone_set('UTC');

# Python
os.environ['TZ'] = 'UTC'

-- 3. å‰ç«¯æ˜¾ç¤ºæ—¶è½¬æ¢ä¸ºç”¨æˆ·æœ¬åœ°æ—¶åŒº
// JavaScript
const userTime = new Date(utcTimeFromDB).toLocaleString();
```

**æ–¹æ¡ˆäºŒï¼šä¸šåŠ¡ä¸»æ—¶åŒºç­–ç•¥**
```sql
-- å¦‚æœä¸šåŠ¡ä¸»è¦åœ¨ä¸­å›½ï¼Œç»Ÿä¸€ä½¿ç”¨Asia/Shanghai
SET GLOBAL time_zone = 'Asia/Shanghai';

-- æ•°æ®åº“è¿æ¥æ—¶è®¾ç½®
mysql --default-character-set=utf8 --init-command="SET time_zone='Asia/Shanghai'"
```

### 6.2 æ—¶åŒºè¡¨åˆå§‹åŒ–


**ğŸ“š MySQLæ—¶åŒºè¡¨è®¾ç½®**
```bash
# åˆå§‹åŒ–MySQLæ—¶åŒºè¡¨ (Linux)
mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root -p mysql

# éªŒè¯æ—¶åŒºè¡¨
mysql -u root -p -e "SELECT COUNT(*) FROM mysql.time_zone_name;"

# å¦‚æœç»“æœå¤§äº0ï¼Œè¯´æ˜æ—¶åŒºè¡¨åˆå§‹åŒ–æˆåŠŸ
```

### 6.3 åº”ç”¨ç¨‹åºæœ€ä½³å®è·µ


**ğŸ’¡ ä»£ç å±‚é¢çš„æ—¶åŒºå¤„ç†**
```java
// Javaæœ€ä½³å®è·µ
public class TimeZoneHandler {
    
    // 1. ç»Ÿä¸€ä½¿ç”¨UTCå­˜å‚¨
    public void saveOrderTime(Order order) {
        Instant utcNow = Instant.now();
        order.setCreateTime(utcNow);
        orderRepository.save(order);
    }
    
    // 2. æŸ¥è¯¢æ—¶è½¬æ¢ä¸ºç”¨æˆ·æ—¶åŒº
    public String getDisplayTime(Instant utcTime, String userTimeZone) {
        ZoneId userZone = ZoneId.of(userTimeZone);
        ZonedDateTime userTime = utcTime.atZone(userZone);
        
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        return userTime.format(formatter);
    }
    
    // 3. è§£æç”¨æˆ·è¾“å…¥æ—¶é—´
    public Instant parseUserTime(String userTimeStr, String userTimeZone) {
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        LocalDateTime localTime = LocalDateTime.parse(userTimeStr, formatter);
        
        ZoneId userZone = ZoneId.of(userTimeZone);
        ZonedDateTime zonedTime = localTime.atZone(userZone);
        
        return zonedTime.toInstant();  // è½¬æ¢ä¸ºUTCå­˜å‚¨
    }
}
```

### 6.4 æ•°æ®åº“è®¾è®¡å»ºè®®


**ğŸ“‹ è¡¨ç»“æ„è®¾è®¡è§„èŒƒ**
```sql
-- æ¨èçš„æ—¶é—´å­—æ®µè®¾è®¡
CREATE TABLE user_activities (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    
    -- 1. ä½¿ç”¨TIMESTAMPå­˜å‚¨UTCæ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- 2. å¦‚æœéœ€è¦ä¿ç•™ç”¨æˆ·æ—¶åŒºä¿¡æ¯
    user_timezone VARCHAR(50) DEFAULT 'UTC',
    
    -- 3. ä¸šåŠ¡æ—¶é—´ä½¿ç”¨DATETIME + æ˜ç¡®æ—¶åŒºè¯´æ˜
    business_date DATE COMMENT 'ä¸šåŠ¡æ—¥æœŸ(åŸºäºç”¨æˆ·æ—¶åŒº)',
    
    INDEX idx_created_at (created_at),
    INDEX idx_user_timezone (user_timezone)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 
COMMENT='ç”¨æˆ·æ´»åŠ¨è®°å½•è¡¨ï¼Œæ‰€æœ‰æ—¶é—´æˆ³ä½¿ç”¨UTCå­˜å‚¨';
```

### 6.5 ç›‘æ§å’Œå‘Šè­¦


**ğŸ“Š æ—¶åŒºç›¸å…³ç›‘æ§æŒ‡æ ‡**
```sql
-- 1. æ—¶åŒºé…ç½®ç›‘æ§
CREATE VIEW timezone_monitoring AS
SELECT 
    'system_time_zone' AS config_item,
    $$system_time_zone AS current_value,
    'Asia/Shanghai' AS expected_value,
    CASE 
        WHEN $$system_time_zone = 'Asia/Shanghai' THEN 'OK'
        ELSE 'ALERT'
    END AS status
UNION ALL
SELECT 
    'time_zone' AS config_item,
    $$time_zone AS current_value,
    '+00:00' AS expected_value,
    CASE 
        WHEN $$time_zone = '+00:00' THEN 'OK'
        ELSE 'ALERT' 
    END AS status;

-- 2. æ—¶é—´ä¸€è‡´æ€§æ£€æŸ¥
SELECT 
    'time_diff_check' AS check_type,
    ABS(TIMESTAMPDIFF(SECOND, NOW(), UTC_TIMESTAMP())) AS diff_seconds,
    CASE 
        WHEN ABS(TIMESTAMPDIFF(SECOND, NOW(), UTC_TIMESTAMP())) <= 1 THEN 'OK'
        ELSE 'ALERT'
    END AS status;
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ æ—¶åŒºæœ¬è´¨ï¼šè§£å†³å…¨çƒä¸åŒåœ°åŒºæ—¶é—´ç»Ÿä¸€æ˜¾ç¤ºçš„é—®é¢˜
ğŸ”¸ MySQLæ—¶åŒºï¼šsystem_time_zone(ç³»ç»Ÿ) + time_zone(ä¼šè¯)ä¸¤çº§è®¾ç½®
ğŸ”¸ å­˜å‚¨åŸç†ï¼šå†…éƒ¨ç”¨UTCå­˜å‚¨ï¼Œæ˜¾ç¤ºæ—¶æŒ‰time_zoneè½¬æ¢
ğŸ”¸ å¸¸è§é—®é¢˜ï¼šæ—¶åŒºä¸ä¸€è‡´ã€å¤ä»¤æ—¶åˆ‡æ¢ã€è·¨æ—¶åŒºåŒæ­¥
ğŸ”¸ æœ€ä½³å®è·µï¼šç»Ÿä¸€UTCå­˜å‚¨ï¼Œåº”ç”¨å±‚å¤„ç†æ˜¾ç¤ºè½¬æ¢
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ—¶åŒºé—®é¢˜çš„æ ¹æº**
```
é—®é¢˜æ ¹æºï¼š
- ä¸åŒç³»ç»Ÿä½¿ç”¨ä¸åŒæ—¶åŒºè®¾ç½®
- æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ—¶åŒºä¿¡æ¯ä¸¢å¤±
- å¤ä»¤æ—¶åˆ‡æ¢æ²¡æœ‰æ­£ç¡®å¤„ç†

è§£å†³æ€è·¯ï¼š
- æ ‡å‡†åŒ–ï¼šç»Ÿä¸€ä½¿ç”¨UTCå­˜å‚¨
- æ˜ç¡®åŒ–ï¼šæ¯ä¸ªæ—¶é—´éƒ½æ˜ç¡®å…¶æ—¶åŒºå«ä¹‰  
- åˆ†ç¦»åŒ–ï¼šå­˜å‚¨ä¸æ˜¾ç¤ºåˆ†ç¦»å¤„ç†
```

**ğŸ”¹ æ’æŸ¥é—®é¢˜çš„æ–¹æ³•**
```
ç³»ç»Ÿæ€§æ’æŸ¥ï¼š
1. ä»åº•å±‚åˆ°ä¸Šå±‚ï¼šç³»ç»Ÿâ†’MySQLâ†’åº”ç”¨â†’ç•Œé¢
2. ä»å­˜å‚¨åˆ°æ˜¾ç¤ºï¼šæ•°æ®åº“å­˜å‚¨â†’ä¼ è¾“â†’æ˜¾ç¤ºè½¬æ¢
3. ä»é…ç½®åˆ°ä»£ç ï¼šé…ç½®æ–‡ä»¶â†’SQLè¯­å¥â†’åº”ç”¨ä»£ç 

å…³é”®æ£€æŸ¥ç‚¹ï¼š
- å„å±‚çº§æ—¶åŒºè®¾ç½®æ˜¯å¦ä¸€è‡´
- æ—¶é—´è½¬æ¢é€»è¾‘æ˜¯å¦æ­£ç¡®
- å†å²æ•°æ®æ˜¯å¦å—åˆ°å½±å“
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é¢„é˜²æ—¶åŒºé—®é¢˜**
```
è®¾è®¡é˜¶æ®µï¼š
âœ… ç¡®å®šç»Ÿä¸€çš„æ—¶åŒºå­˜å‚¨ç­–ç•¥
âœ… è®¾è®¡æ—¶åŒºä¿¡æ¯è®°å½•å­—æ®µ
âœ… åˆ¶å®šæ—¶åŒºé…ç½®æ ‡å‡†

å¼€å‘é˜¶æ®µï¼š
âœ… ä½¿ç”¨æ—¶åŒºå®‰å…¨çš„API
âœ… æ—¶é—´è¾“å…¥è¾“å‡ºéƒ½æ˜ç¡®æ—¶åŒº
âœ… ç¼–å†™æ—¶åŒºç›¸å…³æµ‹è¯•ç”¨ä¾‹

è¿ç»´é˜¶æ®µï¼š
âœ… ç›‘æ§æ—¶åŒºé…ç½®ä¸€è‡´æ€§
âœ… å®šæœŸæ£€æŸ¥æ—¶é—´åŒæ­¥çŠ¶æ€
âœ… å»ºç«‹æ—¶åŒºé—®é¢˜åº”æ€¥é¢„æ¡ˆ
```

**ğŸ”§ æ•…éšœå¤„ç†æµç¨‹**
```
ç´§æ€¥å¤„ç†ï¼š
1. ç¡®å®šå½±å“èŒƒå›´å’Œä¸¥é‡ç¨‹åº¦
2. ä¸´æ—¶ä¿®æ­£æ˜¾ç¤ºé—®é¢˜
3. é€šçŸ¥ç›¸å…³ä¸šåŠ¡æ–¹

æ ¹æœ¬è§£å†³ï¼š
1. åˆ†ææ ¹æœ¬åŸå› 
2. åˆ¶å®šæ ‡å‡†åŒ–æ–¹æ¡ˆ
3. é€æ­¥è¿ç§»å†å²æ•°æ®
4. å»ºç«‹é•¿æœŸç›‘æ§æœºåˆ¶
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ—¶åŒºé—®é¢˜æœ¬è´¨æ˜¯æ—¶é—´ç†è§£ä¸ä¸€è‡´
- UTCå­˜å‚¨ + æœ¬åœ°æ˜¾ç¤ºæ˜¯æœ€ä½³å®è·µ
- ç³»ç»Ÿæ€§æ’æŸ¥æ¯”ç›²ç›®è°ƒè¯•æ›´æœ‰æ•ˆ
- æ ‡å‡†åŒ–é…ç½®æ˜¯é¢„é˜²é—®é¢˜çš„å…³é”®