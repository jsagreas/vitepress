---
title: 12ã€é…ç½®å‚æ•°æ•…éšœæ’æŸ¥
---
## ğŸ“š ç›®å½•


1. [é…ç½®å‚æ•°æ•…éšœæ¦‚è¿°](#1-é…ç½®å‚æ•°æ•…éšœæ¦‚è¿°)
2. [é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯æ’æŸ¥](#2-é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯æ’æŸ¥)
3. [å‚æ•°å€¼èŒƒå›´é—®é¢˜å¤„ç†](#3-å‚æ•°å€¼èŒƒå›´é—®é¢˜å¤„ç†)
4. [å‚æ•°å†²çªæ£€æµ‹ä¸è§£å†³](#4-å‚æ•°å†²çªæ£€æµ‹ä¸è§£å†³)
5. [åŠ¨æ€å‚æ•°è®¾ç½®æ•…éšœ](#5-åŠ¨æ€å‚æ•°è®¾ç½®æ•…éšœ)
6. [é…ç½®æ–‡ä»¶æƒé™é—®é¢˜](#6-é…ç½®æ–‡ä»¶æƒé™é—®é¢˜)
7. [å‚æ•°ä¸ç”Ÿæ•ˆé—®é¢˜è¯Šæ–­](#7-å‚æ•°ä¸ç”Ÿæ•ˆé—®é¢˜è¯Šæ–­)
8. [é…ç½®é‡è½½å¤±è´¥å¤„ç†](#8-é…ç½®é‡è½½å¤±è´¥å¤„ç†)
9. [å‚æ•°å…¼å®¹æ€§é—®é¢˜](#9-å‚æ•°å…¼å®¹æ€§é—®é¢˜)
10. [å‚æ•°ä¼˜åŒ–å‰¯ä½œç”¨](#10-å‚æ•°ä¼˜åŒ–å‰¯ä½œç”¨)
11. [é…ç½®æ–‡ä»¶å¤‡ä»½æ¢å¤](#11-é…ç½®æ–‡ä»¶å¤‡ä»½æ¢å¤)
12. [å‚æ•°å˜æ›´å½±å“åˆ†æ](#12-å‚æ•°å˜æ›´å½±å“åˆ†æ)
13. [é…ç½®éªŒè¯æ–¹æ³•](#13-é…ç½®éªŒè¯æ–¹æ³•)
14. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#14-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ é…ç½®å‚æ•°æ•…éšœæ¦‚è¿°



### 1.1 ä»€ä¹ˆæ˜¯MySQLé…ç½®å‚æ•°æ•…éšœ



**é€šä¿—ç†è§£**ï¼šå°±åƒç»™æ±½è½¦è°ƒå‚æ•°ä¸€æ ·ï¼ŒMySQLä¹Ÿéœ€è¦å„ç§å‚æ•°æ¥æ§åˆ¶è¿è¡Œã€‚å½“è¿™äº›å‚æ•°è®¾ç½®é”™è¯¯ã€å†²çªæˆ–è€…é…ç½®æ–‡ä»¶æœ¬èº«æœ‰é—®é¢˜æ—¶ï¼Œå°±ä¼šå¯¼è‡´MySQLæ— æ³•å¯åŠ¨æˆ–è¿è¡Œå¼‚å¸¸ã€‚

```
ç®€å•ç±»æ¯”ï¼š
MySQLé…ç½®æ–‡ä»¶ = æ±½è½¦çš„æ§åˆ¶é¢æ¿
- å‘åŠ¨æœºåŠŸç‡è®¾ç½® = max_connectionsï¼ˆæœ€å¤§è¿æ¥æ•°ï¼‰
- æ²¹ç®±å¤§å°è®¾ç½® = buffer_pool_sizeï¼ˆç¼“å†²æ± å¤§å°ï¼‰
- å®‰å…¨ç³»ç»Ÿè®¾ç½® = securityç›¸å…³å‚æ•°

å½“è®¾ç½®é”™è¯¯æ—¶ï¼š
- å‚æ•°è¶…å‡ºèŒƒå›´ â†’ æ±½è½¦æ— æ³•å¯åŠ¨
- å‚æ•°å†²çª â†’ æ±½è½¦è¿è¡Œä¸ç¨³å®š
- é…ç½®æ–‡ä»¶æŸå â†’ æ±½è½¦æ— æ³•è¯†åˆ«è®¾ç½®
```

### 1.2 é…ç½®å‚æ•°æ•…éšœçš„å¸¸è§è¡¨ç°



**ğŸ”¸ å¯åŠ¨é˜¶æ®µæ•…éšœ**
```
æ•…éšœç°è±¡ï¼š
- MySQLæœåŠ¡æ— æ³•å¯åŠ¨
- å¯åŠ¨è¿‡ç¨‹ä¸­è‡ªåŠ¨åœæ­¢
- é”™è¯¯æ—¥å¿—ä¸­å‡ºç°é…ç½®ç›¸å…³é”™è¯¯

å…¸å‹é”™è¯¯ä¿¡æ¯ï¼š
[ERROR] unknown variable 'innodb_buffer_pools_size=1G'
[ERROR] option 'max_connections': value '100000' adjusted to '65536'
```

**ğŸ”¸ è¿è¡Œé˜¶æ®µæ•…éšœ**
```
æ•…éšœç°è±¡ï¼š
- æ€§èƒ½çªç„¶ä¸‹é™
- è¿æ¥æ•°å¼‚å¸¸
- å†…å­˜ä½¿ç”¨å¼‚å¸¸
- æŸäº›åŠŸèƒ½å¤±æ•ˆ

ç”¨æˆ·æ„Ÿå—ï¼š
- ç½‘ç«™è®¿é—®å˜æ…¢
- æ•°æ®åº“è¿æ¥å¤±è´¥
- æ“ä½œè¶…æ—¶
```

### 1.3 æ•…éšœæ’æŸ¥æ€è·¯æ¡†æ¶



```
é…ç½®å‚æ•°æ•…éšœæ’æŸ¥æµç¨‹ï¼š

ç¬¬ä¸€æ­¥ï¼šç¡®è®¤æ•…éšœç°è±¡
â”œâ”€â”€ æ— æ³•å¯åŠ¨ï¼Ÿ â†’ æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
â”œâ”€â”€ å¯åŠ¨åå¼‚å¸¸ï¼Ÿ â†’ æ£€æŸ¥å‚æ•°è®¾ç½®
â””â”€â”€ åŠŸèƒ½å¤±æ•ˆï¼Ÿ â†’ æ£€æŸ¥å‚æ•°å…¼å®¹æ€§

ç¬¬äºŒæ­¥ï¼šå®šä½é—®é¢˜æºå¤´
â”œâ”€â”€ è¯­æ³•é”™è¯¯ â†’ é…ç½®æ–‡ä»¶æ ¼å¼é—®é¢˜
â”œâ”€â”€ å‚æ•°é”™è¯¯ â†’ å€¼è®¾ç½®ä¸å½“
â”œâ”€â”€ æƒé™é”™è¯¯ â†’ æ–‡ä»¶è®¿é—®é—®é¢˜
â””â”€â”€ å†²çªé”™è¯¯ â†’ å‚æ•°é—´ç›¸äº’å½±å“

ç¬¬ä¸‰æ­¥ï¼šåˆ¶å®šè§£å†³æ–¹æ¡ˆ
â”œâ”€â”€ ä¿®å¤è¯­æ³• â†’ é‡æ–°ç¼–è¾‘é…ç½®æ–‡ä»¶
â”œâ”€â”€ è°ƒæ•´å‚æ•° â†’ è®¾ç½®åˆç†æ•°å€¼
â”œâ”€â”€ ä¿®å¤æƒé™ â†’ è°ƒæ•´æ–‡ä»¶æƒé™
â””â”€â”€ è§£å†³å†²çª â†’ åè°ƒå‚æ•°è®¾ç½®
```

---

## 2. ğŸ“ é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯æ’æŸ¥



### 2.1 ä»€ä¹ˆæ˜¯é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯



**é€šä¿—è§£é‡Š**ï¼šå°±åƒå†™æ–‡ç« è¦éµå¾ªè¯­æ³•è§„åˆ™ä¸€æ ·ï¼ŒMySQLçš„é…ç½®æ–‡ä»¶`my.cnf`ä¹Ÿæœ‰è‡ªå·±çš„"è¯­æ³•è§„åˆ™"ã€‚å¦‚æœä¸æŒ‰è§„åˆ™å†™ï¼ŒMySQLå°±è¯»ä¸æ‡‚ï¼Œæ— æ³•å¯åŠ¨ã€‚

```
æ­£ç¡®çš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼š
[mysqld]
port = 3306
max_connections = 1000
innodb_buffer_pool_size = 1G

é”™è¯¯çš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼š
[mysqld
port = 3306;  # å¤šäº†åˆ†å·
max connections = 1000  # å‚æ•°åæœ‰ç©ºæ ¼
innodb_buffer_pool_size 1G  # ç¼ºå°‘ç­‰å·
```

### 2.2 å¸¸è§è¯­æ³•é”™è¯¯ç±»å‹



**ğŸ”¸ ç« èŠ‚æ ‡è®°é”™è¯¯**
```markdown
âŒ é”™è¯¯å†™æ³•ï¼š
[mysqld    # ç¼ºå°‘å³æ‹¬å·
port = 3306

[mysql d]  # ç« èŠ‚åæœ‰ç©ºæ ¼
port = 3306

âœ… æ­£ç¡®å†™æ³•ï¼š
[mysqld]
port = 3306
```

**ğŸ”¸ å‚æ•°æ ¼å¼é”™è¯¯**
```markdown
âŒ é”™è¯¯å†™æ³•ï¼š
max connections = 1000    # å‚æ•°åæœ‰ç©ºæ ¼
port =3306               # ç­‰å·ä¸¤è¾¹æ ¼å¼ä¸ä¸€è‡´
innodb_buffer_pool_size: 1G  # ç”¨å†’å·ä»£æ›¿ç­‰å·

âœ… æ­£ç¡®å†™æ³•ï¼š
max_connections = 1000
port = 3306
innodb_buffer_pool_size = 1G
```

**ğŸ”¸ æ³¨é‡Šæ ¼å¼é”™è¯¯**
```markdown
âŒ é”™è¯¯å†™æ³•ï¼š
port = 3306 // è¿™æ˜¯ç«¯å£å·   # ç”¨äº†Javaé£æ ¼æ³¨é‡Š
/* max_connections = 1000 */ # ç”¨äº†Cé£æ ¼æ³¨é‡Š

âœ… æ­£ç¡®å†™æ³•ï¼š
port = 3306  # è¿™æ˜¯ç«¯å£å·
# max_connections = 1000    # è¿™è¡Œè¢«æ³¨é‡Šæ‰äº†

```

### 2.3 è¯­æ³•é”™è¯¯è¯Šæ–­æ–¹æ³•



**ğŸ” æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨mysqldå‘½ä»¤éªŒè¯é…ç½®

mysqld --help --verbose > /dev/null

# æ–¹æ³•2ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•

mysqld --print-defaults

# æ–¹æ³•3ï¼šæŸ¥çœ‹MySQLé”™è¯¯æ—¥å¿—

tail -f /var/log/mysql/error.log
```

**ğŸ“‹ é”™è¯¯ä¿¡æ¯è§£è¯»**
```
å…¸å‹é”™è¯¯ä¿¡æ¯ï¼š
[ERROR] [MY-000067] [Server] unknown variable 'max connections=1000'
å«ä¹‰ï¼šå‚æ•°å"max connections"ä¸æ­£ç¡®ï¼Œåº”è¯¥æ˜¯"max_connections"

[ERROR] [MY-000068] [Server] option 'port': empty value
å«ä¹‰ï¼športå‚æ•°æ²¡æœ‰è®¾ç½®å€¼

[ERROR] [MY-011011] [Server] Failed to find valid data directory
å«ä¹‰ï¼šæ•°æ®ç›®å½•é…ç½®é”™è¯¯æˆ–è·¯å¾„ä¸å­˜åœ¨
```

### 2.4 è¯­æ³•é”™è¯¯ä¿®å¤æ­¥éª¤



**ğŸ“ æ ‡å‡†ä¿®å¤æµç¨‹**
```markdown
æ­¥éª¤1ï¼šå¤‡ä»½åŸé…ç½®æ–‡ä»¶
cp /etc/mysql/my.cnf /etc/mysql/my.cnf.backup

æ­¥éª¤2ï¼šæ£€æŸ¥è¯­æ³•é”™è¯¯
- æ£€æŸ¥æ¯ä¸ªç« èŠ‚æ ‡è®° [section] æ˜¯å¦å®Œæ•´
- æ£€æŸ¥å‚æ•°åæ˜¯å¦æ­£ç¡®ï¼ˆç”¨ä¸‹åˆ’çº¿è¿æ¥ï¼‰
- æ£€æŸ¥ç­‰å·ä¸¤è¾¹æ˜¯å¦æœ‰å¤šä½™ç©ºæ ¼
- æ£€æŸ¥æ³¨é‡Šæ˜¯å¦ä½¿ç”¨ # å¼€å¤´

æ­¥éª¤3ï¼šé€è¡ŒéªŒè¯å‚æ•°
- ç¡®è®¤å‚æ•°åæ‹¼å†™æ­£ç¡®
- ç¡®è®¤å‚æ•°å€¼æ ¼å¼æ­£ç¡®
- ç¡®è®¤ç« èŠ‚å½’å±æ­£ç¡®

æ­¥éª¤4ï¼šæµ‹è¯•é…ç½®æ–‡ä»¶
mysqld --print-defaults --defaults-file=/etc/mysql/my.cnf
```

---

## 3. ğŸ“Š å‚æ•°å€¼èŒƒå›´é—®é¢˜å¤„ç†



### 3.1 ä»€ä¹ˆæ˜¯å‚æ•°å€¼èŒƒå›´é—®é¢˜



**é€šä¿—ç†è§£**ï¼šæ¯ä¸ªMySQLå‚æ•°éƒ½æœ‰è‡ªå·±çš„"å®‰å…¨èŒƒå›´"ï¼Œå°±åƒæ±½è½¦çš„é€Ÿåº¦è¡¨ä¸€æ ·ï¼Œè¶…å‡ºèŒƒå›´å°±å±é™©äº†ã€‚æ¯”å¦‚æœ€å¤§è¿æ¥æ•°ä¸èƒ½è®¾ç½®æˆè´Ÿæ•°ï¼Œå†…å­˜ç¼“å†²æ± ä¹Ÿä¸èƒ½æ¯”ç³»ç»Ÿå†…å­˜è¿˜å¤§ã€‚

```
å‚æ•°èŒƒå›´ç±»æ¯”ï¼š
max_connections = æ±½è½¦è½½å®¢æ•°
- æœ€å°å€¼ï¼š1ï¼ˆè‡³å°‘è¦èƒ½è¿ä¸€ä¸ªç”¨æˆ·ï¼‰
- æœ€å¤§å€¼ï¼š100000ï¼ˆç³»ç»Ÿèƒ½æ‰¿å—çš„æé™ï¼‰
- è®¾ç½®0 â†’ ç­‰äºè¯´æ±½è½¦ä¸è½½å®¢ï¼ˆæ— æ„ä¹‰ï¼‰
- è®¾ç½®1000000 â†’ è¶…å‡ºç³»ç»Ÿæ‰¿å—èƒ½åŠ›ï¼ˆä¼šå´©æºƒï¼‰
```

### 3.2 å¸¸è§å‚æ•°èŒƒå›´é”™è¯¯



**ğŸ”¸ è¿æ¥æ•°å‚æ•°é”™è¯¯**
```sql
-- é”™è¯¯è®¾ç½®ç¤ºä¾‹
max_connections = 0          # ä¸èƒ½ä¸º0ï¼Œè‡³å°‘è¦1
max_connections = 1000000    # è¶…å‡ºç³»ç»Ÿé™åˆ¶
max_connections = -100       # ä¸èƒ½ä¸ºè´Ÿæ•°

-- æ­£ç¡®è®¾ç½®ç¤ºä¾‹
max_connections = 1000       # åˆç†èŒƒå›´å†…
```

**ğŸ”¸ å†…å­˜å‚æ•°é”™è¯¯**
```sql
-- å‡è®¾ç³»ç»Ÿæ€»å†…å­˜4GB
innodb_buffer_pool_size = 8G    # è¶…å‡ºç³»ç»Ÿå†…å­˜
innodb_buffer_pool_size = -1G   # è´Ÿæ•°æ— æ„ä¹‰
innodb_buffer_pool_size = 0     # å¤ªå°å½±å“æ€§èƒ½

-- æ­£ç¡®è®¾ç½®ï¼ˆä¸€èˆ¬æ˜¯æ€»å†…å­˜çš„60-80%ï¼‰
innodb_buffer_pool_size = 2G    # åˆç†è®¾ç½®
```

**ğŸ”¸ è¶…æ—¶å‚æ•°é”™è¯¯**
```sql
-- é”™è¯¯è®¾ç½®
wait_timeout = -1            # è´Ÿæ•°æ— æ„ä¹‰
interactive_timeout = 0      # 0è¡¨ç¤ºç«‹å³è¶…æ—¶
connect_timeout = 1000000    # è¿‡å¤§å¯¼è‡´èµ„æºæµªè´¹

-- æ­£ç¡®è®¾ç½®
wait_timeout = 3600          # 1å°æ—¶ï¼ˆ3600ç§’ï¼‰
interactive_timeout = 3600   # 1å°æ—¶
connect_timeout = 10         # 10ç§’è¿æ¥è¶…æ—¶
```

### 3.3 å‚æ•°èŒƒå›´æ£€æŸ¥æ–¹æ³•



**ğŸ” æŸ¥çœ‹å‚æ•°èŒƒå›´é™åˆ¶**
```sql
-- æŸ¥çœ‹å‚æ•°çš„æœ€å°å€¼å’Œæœ€å¤§å€¼
SHOW VARIABLES LIKE 'max_connections';
SELECT $$global.max_connections;

-- æŸ¥çœ‹å‚æ•°è¯¦ç»†ä¿¡æ¯ï¼ˆMySQL 8.0+ï¼‰
SELECT * FROM performance_schema.variables_info 
WHERE VARIABLE_NAME = 'max_connections';
```

**ğŸ“‹ ç³»ç»Ÿé™åˆ¶æ£€æŸ¥**
```bash
# æ£€æŸ¥ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦é™åˆ¶

ulimit -n

# æ£€æŸ¥ç³»ç»Ÿå†…å­˜

free -h

# æ£€æŸ¥MySQLè¿›ç¨‹é™åˆ¶

cat /proc/$(pidof mysqld)/limits
```

### 3.4 å‚æ•°å€¼è°ƒæ•´ç­–ç•¥



**ğŸ¯ å®‰å…¨è°ƒæ•´åŸåˆ™**
```markdown
åŸåˆ™1ï¼šæ¸è¿›å¼è°ƒæ•´
- ä¸è¦ä¸€æ¬¡æ€§å¤§å¹…ä¿®æ”¹å‚æ•°
- æ¯æ¬¡è°ƒæ•´10-20%ï¼Œè§‚å¯Ÿæ•ˆæœ
- è®°å½•æ¯æ¬¡è°ƒæ•´çš„æ•°å€¼å’Œæ•ˆæœ

åŸåˆ™2ï¼šåŸºäºå®é™…éœ€æ±‚
- æ ¹æ®ä¸šåŠ¡é‡è®¾ç½®è¿æ¥æ•°
- æ ¹æ®æ•°æ®é‡è®¾ç½®ç¼“å†²æ± 
- æ ¹æ®ç½‘ç»œç¯å¢ƒè®¾ç½®è¶…æ—¶

åŸåˆ™3ï¼šè€ƒè™‘ç³»ç»Ÿèµ„æº
- å†…å­˜å‚æ•°ä¸è¶…è¿‡ç³»ç»Ÿå¯ç”¨å†…å­˜çš„80%
- è¿æ¥æ•°ä¸è¶…è¿‡ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦é™åˆ¶
- CPUç›¸å…³å‚æ•°è¦è€ƒè™‘CPUæ ¸å¿ƒæ•°
```

**ğŸ“ è°ƒæ•´æ­¥éª¤ç¤ºä¾‹**
```sql
-- æ­¥éª¤1ï¼šæŸ¥çœ‹å½“å‰è®¾ç½®
SHOW VARIABLES LIKE 'max_connections';

-- æ­¥éª¤2ï¼šè®¡ç®—åˆç†æ•°å€¼
-- å‡è®¾å½“å‰æœ€å¤§å¹¶å‘200ï¼Œè®¾ç½®ä¸º400ï¼ˆé¢„ç•™ç¼“å†²ï¼‰

-- æ­¥éª¤3ï¼šåŠ¨æ€è°ƒæ•´æµ‹è¯•
SET GLOBAL max_connections = 400;

-- æ­¥éª¤4ï¼šè§‚å¯Ÿè¿è¡Œæƒ…å†µ
SHOW STATUS LIKE 'Max_used_connections';
SHOW STATUS LIKE 'Threads_connected';

-- æ­¥éª¤5ï¼šå¦‚æœè¿è¡Œç¨³å®šï¼Œå†™å…¥é…ç½®æ–‡ä»¶
-- ç¼–è¾‘ /etc/mysql/my.cnf
-- max_connections = 400
```

---

## 4. âš–ï¸ å‚æ•°å†²çªæ£€æµ‹ä¸è§£å†³



### 4.1 ä»€ä¹ˆæ˜¯å‚æ•°å†²çª



**é€šä¿—ç†è§£**ï¼šæœ‰äº›MySQLå‚æ•°ä¹‹é—´ä¼š"æ‰“æ¶"ï¼Œå°±åƒä½ åŒæ—¶è¸©æ²¹é—¨å’Œåˆ¹è½¦ä¸€æ ·ã€‚æ¯”å¦‚ä½ è®¾ç½®äº†å¾ˆå¤§çš„ç¼“å†²æ± ï¼Œä½†æ˜¯åˆé™åˆ¶äº†å¾ˆå°çš„å†…å­˜ä½¿ç”¨é‡ï¼Œè¿™ä¸¤ä¸ªè®¾ç½®å°±å†²çªäº†ã€‚

```
å‚æ•°å†²çªä¸¾ä¾‹ï¼š
è®¾ç½®1ï¼šinnodb_buffer_pool_size = 2G  ï¼ˆéœ€è¦2Gå†…å­˜ï¼‰
è®¾ç½®2ï¼šmax_heap_table_size = 3G      ï¼ˆéœ€è¦3Gå†…å­˜ï¼‰
è®¾ç½®3ï¼šquery_cache_size = 1G         ï¼ˆéœ€è¦1Gå†…å­˜ï¼‰
æ€»éœ€æ±‚ï¼š6Gå†…å­˜ï¼Œä½†ç³»ç»Ÿåªæœ‰4G â†’ å†²çªï¼

ç»“æœï¼šMySQLå¯èƒ½å¯åŠ¨å¤±è´¥æˆ–è¿è¡Œå¼‚å¸¸
```

### 4.2 å¸¸è§å‚æ•°å†²çªç±»å‹



**ğŸ”¸ å†…å­˜åˆ†é…å†²çª**
```sql
-- å†²çªç¤ºä¾‹ï¼šæ€»å†…å­˜éœ€æ±‚è¶…å‡ºç³»ç»Ÿå¯ç”¨å†…å­˜
innodb_buffer_pool_size = 3G     # InnoDBç¼“å†²æ± 
key_buffer_size = 1G             # MyISAMé”®ç¼“å†²
query_cache_size = 1G            # æŸ¥è¯¢ç¼“å­˜
tmp_table_size = 512M            # ä¸´æ—¶è¡¨å¤§å°
max_heap_table_size = 512M       # å †è¡¨å¤§å°
-- æ€»è®¡çº¦6Gï¼Œè¶…å‡º4Gç³»ç»Ÿå†…å­˜

-- è§£å†³æ–¹æ¡ˆï¼šåˆç†åˆ†é…å†…å­˜
innodb_buffer_pool_size = 2G     # é™ä½åˆ°2G
key_buffer_size = 256M           # é™ä½åˆ°256M
query_cache_size = 0             # å…³é—­æŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL 8.0å·²åºŸå¼ƒï¼‰
tmp_table_size = 256M            # é™ä½åˆ°256M
max_heap_table_size = 256M       # é™ä½åˆ°256M
-- æ€»è®¡çº¦3Gï¼Œç•™1Gç»™ç³»ç»Ÿ
```

**ğŸ”¸ è¿æ¥æ•°ä¸çº¿ç¨‹å†²çª**
```sql
-- å†²çªç¤ºä¾‹ï¼šè¿æ¥æ•°è®¾ç½®ä¸çº¿ç¨‹æ± ä¸åŒ¹é…
max_connections = 2000           # æœ€å¤§2000ä¸ªè¿æ¥
thread_cache_size = 50           # çº¿ç¨‹ç¼“å­˜åªæœ‰50
thread_pool_size = 100           # çº¿ç¨‹æ± åªæœ‰100ä¸ªçº¿ç¨‹

-- é—®é¢˜ï¼š2000ä¸ªè¿æ¥ä½†åªæœ‰100ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œä¼šå¯¼è‡´æ’é˜Ÿç­‰å¾…

-- è§£å†³æ–¹æ¡ˆï¼šåè°ƒè®¾ç½®
max_connections = 1000           # é™ä½è¿æ¥æ•°
thread_cache_size = 200          # å¢åŠ çº¿ç¨‹ç¼“å­˜
thread_pool_size = 200           # å¢åŠ çº¿ç¨‹æ± å¤§å°
```

**ğŸ”¸ å­˜å‚¨å¼•æ“å†²çª**
```sql
-- å†²çªç¤ºä¾‹ï¼šä¸ºMyISAMä¼˜åŒ–ä½†ä¸»è¦ä½¿ç”¨InnoDB
default_storage_engine = innodb  # é»˜è®¤ä½¿ç”¨InnoDB
key_buffer_size = 2G            # ç»™MyISAMåˆ†é…å¤§é‡å†…å­˜
innodb_buffer_pool_size = 512M  # ç»™InnoDBåˆ†é…å¾ˆå°‘å†…å­˜

-- é—®é¢˜ï¼šèµ„æºåˆ†é…ä¸å®é™…ä½¿ç”¨ä¸ç¬¦

-- è§£å†³æ–¹æ¡ˆï¼šæ ¹æ®å®é™…å¼•æ“è°ƒæ•´
default_storage_engine = innodb
key_buffer_size = 128M          # MyISAMç”¨å¾—å°‘ï¼Œå‡å°‘åˆ†é…
innodb_buffer_pool_size = 2G    # InnoDBç”¨å¾—å¤šï¼Œå¢åŠ åˆ†é…
```

### 4.3 å†²çªæ£€æµ‹æ–¹æ³•



**ğŸ” æ‰‹åŠ¨æ£€æµ‹å†²çª**
```sql
-- æ£€æŸ¥å†…å­˜åˆ†é…æ€»é‡
SELECT 
  $$innodb_buffer_pool_size / 1024 / 1024 / 1024 AS 'InnoDB Buffer (GB)',
  $$key_buffer_size / 1024 / 1024 / 1024 AS 'Key Buffer (GB)',
  $$query_cache_size / 1024 / 1024 / 1024 AS 'Query Cache (GB)',
  $$tmp_table_size / 1024 / 1024 AS 'Tmp Table (MB)',
  $$max_heap_table_size / 1024 / 1024 AS 'Heap Table (MB)';

-- æ£€æŸ¥è¿æ¥ä¸çº¿ç¨‹é…ç½®
SELECT 
  $$max_connections AS 'Max Connections',
  $$thread_cache_size AS 'Thread Cache',
  $$thread_pool_size AS 'Thread Pool Size';
```

**ğŸ“Š ç³»ç»Ÿèµ„æºå¯¹æ¯”**
```bash
# æ£€æŸ¥ç³»ç»Ÿå¯ç”¨å†…å­˜

free -h

# æ£€æŸ¥MySQLå®é™…å†…å­˜ä½¿ç”¨

ps aux | grep mysqld
pmap -d $(pidof mysqld)

# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½

top
iostat 1
```

### 4.4 å†²çªè§£å†³ç­–ç•¥



**ğŸ¯ è§£å†³å†²çªçš„åŸºæœ¬åŸåˆ™**
```markdown
åŸåˆ™1ï¼šä¼˜å…ˆä¿è¯æ ¸å¿ƒåŠŸèƒ½
- InnoDBç¼“å†²æ±  > MyISAMé”®ç¼“å†²ï¼ˆå¦‚æœä¸»è¦ç”¨InnoDBï¼‰
- è¿æ¥æ•° > çº¿ç¨‹ç¼“å­˜ï¼ˆä¿è¯è¿æ¥ç¨³å®šæ€§ï¼‰
- åŸºç¡€å†…å­˜ > é«˜çº§ç‰¹æ€§ï¼ˆä¿è¯ç³»ç»Ÿç¨³å®šï¼‰

åŸåˆ™2ï¼šæŒ‰ä½¿ç”¨é¢‘ç‡åˆ†é…èµ„æº
- å¸¸ç”¨åŠŸèƒ½å¤šåˆ†é…èµ„æº
- ä¸ç”¨åŠŸèƒ½å¯ä»¥å…³é—­
- å¶å°”ç”¨çš„åŠŸèƒ½åˆ†é…åŸºç¡€èµ„æº

åŸåˆ™3ï¼šé¢„ç•™ç³»ç»Ÿèµ„æº
- æ•°æ®åº“å ç”¨ç³»ç»Ÿèµ„æºä¸è¶…è¿‡80%
- ä¸ºæ“ä½œç³»ç»Ÿé¢„ç•™è¶³å¤Ÿå†…å­˜
- ä¸ºå…¶ä»–åº”ç”¨é¢„ç•™èµ„æº
```

**ğŸ“ å†²çªè§£å†³æ­¥éª¤**
```markdown
æ­¥éª¤1ï¼šè¯†åˆ«å†²çªå‚æ•°
- åˆ—å‡ºæ‰€æœ‰å†…å­˜ç›¸å…³å‚æ•°
- è®¡ç®—æ€»å†…å­˜éœ€æ±‚
- å¯¹æ¯”ç³»ç»Ÿå¯ç”¨å†…å­˜

æ­¥éª¤2ï¼šè¯„ä¼°å‚æ•°é‡è¦æ€§
- ç¡®å®šå“ªäº›å‚æ•°æ˜¯å¿…éœ€çš„
- ç¡®å®šå“ªäº›å‚æ•°å¯ä»¥è°ƒæ•´
- ç¡®å®šå“ªäº›å‚æ•°å¯ä»¥å…³é—­

æ­¥éª¤3ï¼šåˆ¶å®šè°ƒæ•´æ–¹æ¡ˆ
- ä¿ç•™æ ¸å¿ƒå‚æ•°è®¾ç½®
- è°ƒæ•´æ¬¡è¦å‚æ•°æ•°å€¼
- å…³é—­ä¸å¿…è¦çš„åŠŸèƒ½

æ­¥éª¤4ï¼šåˆ†æ­¥éª¤å®æ–½
- å…ˆè°ƒæ•´ä¸€ä¸¤ä¸ªå‚æ•°
- è§‚å¯Ÿç³»ç»Ÿè¿è¡Œæƒ…å†µ
- é€æ­¥è°ƒæ•´å…¶ä»–å‚æ•°

æ­¥éª¤5ï¼šéªŒè¯è§£å†³æ•ˆæœ
- æ£€æŸ¥MySQLå¯åŠ¨æ­£å¸¸
- æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡
- æ£€æŸ¥é”™è¯¯æ—¥å¿—
```

---

## 5. ğŸ”„ åŠ¨æ€å‚æ•°è®¾ç½®æ•…éšœ



### 5.1 ä»€ä¹ˆæ˜¯åŠ¨æ€å‚æ•°è®¾ç½®



**é€šä¿—ç†è§£**ï¼šåŠ¨æ€å‚æ•°å°±åƒæ±½è½¦çš„ç©ºè°ƒï¼Œä½ å¯ä»¥åœ¨å¼€è½¦è¿‡ç¨‹ä¸­è°ƒèŠ‚æ¸©åº¦ï¼Œä¸éœ€è¦åœè½¦é‡å¯ã€‚MySQLçš„å¾ˆå¤šå‚æ•°ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶è°ƒæ•´ï¼Œä¸éœ€è¦é‡å¯æ•°æ®åº“ã€‚

```
å‚æ•°ç±»å‹å¯¹æ¯”ï¼š
é™æ€å‚æ•° = æ±½è½¦çš„å‘åŠ¨æœºæ’é‡
- éœ€è¦é‡å¯MySQLæ‰èƒ½ç”Ÿæ•ˆ
- ä¾‹å¦‚ï¼športã€datadirã€socket

åŠ¨æ€å‚æ•° = æ±½è½¦çš„ç©ºè°ƒæ¸©åº¦
- å¯ä»¥å³æ—¶è°ƒæ•´ï¼Œç«‹å³ç”Ÿæ•ˆ
- ä¾‹å¦‚ï¼šmax_connectionsã€innodb_buffer_pool_size
```

### 5.2 åŠ¨æ€å‚æ•°è®¾ç½®å¤±è´¥çš„å¸¸è§åŸå› 



**ğŸ”¸ å‚æ•°ä¸æ”¯æŒåŠ¨æ€ä¿®æ”¹**
```sql
-- é”™è¯¯ç¤ºä¾‹ï¼šå°è¯•åŠ¨æ€ä¿®æ”¹é™æ€å‚æ•°
SET GLOBAL port = 3307;
-- é”™è¯¯ä¿¡æ¯ï¼šVariable 'port' is a read only variable

-- åŸå› ï¼športæ˜¯é™æ€å‚æ•°ï¼Œåªèƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹åé‡å¯
```

**ğŸ”¸ æƒé™ä¸è¶³**
```sql
-- é”™è¯¯ç¤ºä¾‹ï¼šæ™®é€šç”¨æˆ·å°è¯•ä¿®æ”¹å…¨å±€å‚æ•°
mysql -u normaluser -p
SET GLOBAL max_connections = 2000;
-- é”™è¯¯ä¿¡æ¯ï¼šAccess denied; you need SUPER privilege for this operation

-- è§£å†³ï¼šä½¿ç”¨æœ‰SUPERæƒé™çš„ç”¨æˆ·
mysql -u root -p
SET GLOBAL max_connections = 2000;
```

**ğŸ”¸ å‚æ•°å€¼ä¸åˆæ³•**
```sql
-- é”™è¯¯ç¤ºä¾‹ï¼šè®¾ç½®è¶…å‡ºèŒƒå›´çš„å€¼
SET GLOBAL max_connections = -100;
-- é”™è¯¯ä¿¡æ¯ï¼šIncorrect argument type to variable 'max_connections'

SET GLOBAL innodb_buffer_pool_size = 100G;
-- é”™è¯¯ä¿¡æ¯ï¼šValue '107374182400' adjusted to '107374182400'
-- ï¼ˆå¯èƒ½è¢«è‡ªåŠ¨è°ƒæ•´åˆ°ç³»ç»Ÿé™åˆ¶å†…ï¼‰
```

**ğŸ”¸ å‚æ•°ä¾èµ–å…³ç³»é”™è¯¯**
```sql
-- é”™è¯¯ç¤ºä¾‹ï¼šè®¾ç½®äº†ç›¸äº’å†²çªçš„å‚æ•°
SET GLOBAL query_cache_type = 1;        # å¼€å¯æŸ¥è¯¢ç¼“å­˜
SET GLOBAL query_cache_size = 0;        # ä½†ç¼“å­˜å¤§å°ä¸º0
-- ç»“æœï¼šæŸ¥è¯¢ç¼“å­˜å®é™…ä¸å·¥ä½œ
```

### 5.3 åŠ¨æ€å‚æ•°è®¾ç½®çš„æ­£ç¡®æ–¹æ³•



**ğŸ” æ£€æŸ¥å‚æ•°æ˜¯å¦æ”¯æŒåŠ¨æ€ä¿®æ”¹**
```sql
-- æŸ¥çœ‹å‚æ•°è¯¦ç»†ä¿¡æ¯
SHOW VARIABLES LIKE 'max_connections';

-- æŸ¥çœ‹å‚æ•°æ˜¯å¦åŠ¨æ€ï¼ˆMySQL 8.0+ï¼‰
SELECT VARIABLE_NAME, VARIABLE_SCOPE, VARIABLE_TYPE, SET_TIME, SET_USER_NAME
FROM performance_schema.variables_info 
WHERE VARIABLE_NAME = 'max_connections';

-- å°è¯•è®¾ç½®å‚æ•°ï¼ˆæµ‹è¯•æ˜¯å¦æ”¯æŒåŠ¨æ€ä¿®æ”¹ï¼‰
SELECT $$max_connections;  # æŸ¥çœ‹å½“å‰å€¼
SET GLOBAL max_connections = $$max_connections;  # è®¾ç½®ç›¸åŒå€¼æµ‹è¯•
```

**ğŸ“ æ­£ç¡®çš„è®¾ç½®æ­¥éª¤**
```sql
-- æ­¥éª¤1ï¼šæ£€æŸ¥å½“å‰å€¼
SELECT $$global.max_connections AS current_value;

-- æ­¥éª¤2ï¼šæ£€æŸ¥åˆç†èŒƒå›´
SHOW VARIABLES LIKE 'max_connections';

-- æ­¥éª¤3ï¼šåŠ¨æ€è®¾ç½®æ–°å€¼
SET GLOBAL max_connections = 1500;

-- æ­¥éª¤4ï¼šéªŒè¯è®¾ç½®ç»“æœ
SELECT $$global.max_connections AS new_value;

-- æ­¥éª¤5ï¼šæ£€æŸ¥è¿è¡ŒçŠ¶æ€
SHOW STATUS LIKE 'Max_used_connections';
SHOW STATUS LIKE 'Threads_connected';
```

### 5.4 åŠ¨æ€å‚æ•°æŒä¹…åŒ–



**ğŸ’¾ ä¸´æ—¶è®¾ç½®vsæŒä¹…è®¾ç½®**
```sql
-- æ–¹æ³•1ï¼šä¸´æ—¶è®¾ç½®ï¼ˆé‡å¯åå¤±æ•ˆï¼‰
SET GLOBAL max_connections = 1500;

-- æ–¹æ³•2ï¼šæŒä¹…è®¾ç½®ï¼ˆMySQL 8.0+ï¼Œé‡å¯åä¿æŒï¼‰
SET PERSIST max_connections = 1500;

-- æ–¹æ³•3ï¼šä»…åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼ˆé‡å¯åç”Ÿæ•ˆï¼‰
SET PERSIST_ONLY max_connections = 1500;
```

**ğŸ“ é…ç½®æ–‡ä»¶åŒæ­¥**
```bash
# å³ä½¿ä½¿ç”¨åŠ¨æ€è®¾ç½®ï¼Œä¹Ÿå»ºè®®åŒæ­¥åˆ°é…ç½®æ–‡ä»¶

# ç¼–è¾‘ /etc/mysql/my.cnf

[mysqld]
max_connections = 1500

# è¿™æ ·ç¡®ä¿é‡å¯åè®¾ç½®ä»ç„¶æœ‰æ•ˆ

```

### 5.5 åŠ¨æ€è®¾ç½®æ•…éšœæ’é™¤



**ğŸ”§ å¸¸è§æ•…éšœå¤„ç†**
```sql
-- æ•…éšœ1ï¼šè®¾ç½®åæ²¡æœ‰ç”Ÿæ•ˆ
-- æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†GLOBALçº§åˆ«
SET GLOBAL max_connections = 1500;  # æ­£ç¡®
SET max_connections = 1500;         # é”™è¯¯ï¼šåªå½±å“å½“å‰ä¼šè¯

-- æ•…éšœ2ï¼šè®¾ç½®äº†ä½†æŸ¥è¯¢æ˜¾ç¤ºä¸åŒå€¼
-- æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªé…ç½®ç”Ÿæ•ˆ
SHOW VARIABLES LIKE 'max_connections';
SELECT $$global.max_connections, $$session.max_connections;

-- æ•…éšœ3ï¼šå‚æ•°è®¾ç½®å¯¼è‡´æ€§èƒ½é—®é¢˜
-- é€æ­¥è°ƒæ•´ï¼Œè§‚å¯Ÿæ•ˆæœ
SET GLOBAL innodb_buffer_pool_size = 1G;  # è®¾ç½®è¾ƒå°å€¼
-- è§‚å¯Ÿæ€§èƒ½æŒ‡æ ‡
-- å¦‚æœç¨³å®šï¼Œå†ç»§ç»­è°ƒå¤§
SET GLOBAL innodb_buffer_pool_size = 2G;
```

**ğŸ“Š è®¾ç½®æ•ˆæœç›‘æ§**
```sql
-- ç›‘æ§è¿æ¥æ•°ä½¿ç”¨æƒ…å†µ
SELECT 
    $$max_connections AS max_allowed,
    (SELECT COUNT(*) FROM information_schema.PROCESSLIST) AS current_connections,
    (SELECT VARIABLE_VALUE FROM performance_schema.global_status 
     WHERE VARIABLE_NAME = 'Max_used_connections') AS max_used;

-- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
SELECT 
    $$innodb_buffer_pool_size / 1024 / 1024 AS buffer_pool_mb,
    (SELECT COUNT(*) * $$innodb_page_size FROM information_schema.INNODB_BUFFER_PAGE) 
    / 1024 / 1024 AS used_buffer_mb;
```

---

## 6. ğŸ” é…ç½®æ–‡ä»¶æƒé™é—®é¢˜



### 6.1 ä»€ä¹ˆæ˜¯é…ç½®æ–‡ä»¶æƒé™é—®é¢˜



**é€šä¿—ç†è§£**ï¼šå°±åƒå®¶é‡Œçš„é—¨é”ä¸€æ ·ï¼ŒMySQLé…ç½®æ–‡ä»¶ä¹Ÿæœ‰"é—¨é”"ä¿æŠ¤ã€‚å¦‚æœæƒé™è®¾ç½®ä¸å¯¹ï¼ŒMySQLå°±åƒæ‹¿ä¸åˆ°é’¥åŒ™ï¼Œè¯»ä¸äº†é…ç½®æ–‡ä»¶ï¼Œè‡ªç„¶å¯åŠ¨ä¸äº†ã€‚

```
æƒé™ç±»æ¯”ï¼š
é…ç½®æ–‡ä»¶ = é‡è¦æ–‡æ¡£
æ–‡ä»¶æƒé™ = æ–‡æ¡£çš„æŸ¥çœ‹æƒé™

æƒé™è®¾ç½®ï¼š
- å¤ªæ¾ï¼ˆ777ï¼‰â†’ è°éƒ½èƒ½æ”¹ï¼Œä¸å®‰å…¨
- å¤ªä¸¥ï¼ˆ000ï¼‰â†’ è¿MySQLè‡ªå·±éƒ½è¯»ä¸äº†
- åˆšå¥½ï¼ˆ644ï¼‰â†’ ä¸»äººèƒ½è¯»å†™ï¼Œå…¶ä»–äººåªèƒ½è¯»
```

### 6.2 æƒé™é—®é¢˜çš„å¸¸è§è¡¨ç°



**ğŸš¨ MySQLæ— æ³•è¯»å–é…ç½®æ–‡ä»¶**
```bash
# é”™è¯¯æ—¥å¿—ä¸­çš„å…¸å‹é”™è¯¯

[ERROR] Fatal error: Can't open and lock privilege tables: Table 'mysql.user' doesn't exist
[ERROR] mysqld: Can't read dir of '/etc/mysql/conf.d/' (Errcode: 13 - Permission denied)
[ERROR] Could not open required defaults file: /etc/mysql/my.cnf
```

**ğŸ” æƒé™æ£€æŸ¥å‘½ä»¤**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™

ls -la /etc/mysql/my.cnf
# è¾“å‡ºç¤ºä¾‹ï¼š

# -rw-r--r-- 1 root root 1234 Oct 15 10:30 /etc/mysql/my.cnf

# æƒé™è§£è¯»ï¼š

# - ç¬¬ä¸€ä½ï¼šæ–‡ä»¶ç±»å‹ï¼ˆ-è¡¨ç¤ºæ™®é€šæ–‡ä»¶ï¼‰

# - 2-4ä½ï¼šæ‰€æœ‰è€…æƒé™ï¼ˆrw-è¡¨ç¤ºè¯»å†™ï¼‰

# - 5-7ä½ï¼šç”¨æˆ·ç»„æƒé™ï¼ˆr--è¡¨ç¤ºåªè¯»ï¼‰

# - 8-10ä½ï¼šå…¶ä»–ç”¨æˆ·æƒé™ï¼ˆr--è¡¨ç¤ºåªè¯»ï¼‰


# æ£€æŸ¥é…ç½®ç›®å½•æƒé™

ls -la /etc/mysql/
ls -la /var/lib/mysql/
```

### 6.3 æ­£ç¡®çš„æƒé™è®¾ç½®



**ğŸ“‹ æ ‡å‡†æƒé™é…ç½®**
```bash
# ä¸»é…ç½®æ–‡ä»¶æƒé™

chmod 644 /etc/mysql/my.cnf          # æ‰€æœ‰è€…è¯»å†™ï¼Œå…¶ä»–äººåªè¯»
chown root:root /etc/mysql/my.cnf    # å±ä¸»è®¾ä¸ºroot

# é…ç½®ç›®å½•æƒé™

chmod 755 /etc/mysql/                # ç›®å½•å¯æ‰§è¡Œï¼Œæ‰èƒ½è¿›å…¥
chown root:root /etc/mysql/

# æ•°æ®ç›®å½•æƒé™ï¼ˆé‡è¦ï¼ï¼‰

chmod 750 /var/lib/mysql/            # åªæœ‰mysqlç”¨æˆ·å’Œrootèƒ½è®¿é—®
chown mysql:mysql /var/lib/mysql/

# æ—¥å¿—æ–‡ä»¶æƒé™

chmod 640 /var/log/mysql/error.log   # mysqlç»„å¯è¯»
chown mysql:adm /var/log/mysql/error.log
```

**ğŸ”’ å®‰å…¨æƒé™åŸåˆ™**
```markdown
åŸåˆ™1ï¼šæœ€å°æƒé™åŸåˆ™
- é…ç½®æ–‡ä»¶ï¼šåªç»™å¿…è¦çš„è¯»æƒé™
- æ•°æ®ç›®å½•ï¼šåªæœ‰mysqlç”¨æˆ·èƒ½è®¿é—®
- æ—¥å¿—æ–‡ä»¶ï¼šåªæœ‰mysqlç”¨æˆ·èƒ½å†™

åŸåˆ™2ï¼šç”¨æˆ·åˆ†ç¦»åŸåˆ™
- é…ç½®æ–‡ä»¶ï¼šrootç”¨æˆ·æ‹¥æœ‰
- æ•°æ®æ–‡ä»¶ï¼šmysqlç”¨æˆ·æ‹¥æœ‰
- é¿å…ä½¿ç”¨777ç­‰è¿‡å®½æƒé™

åŸåˆ™3ï¼šç›®å½•ä¸æ–‡ä»¶åŒºåˆ†
- ç›®å½•éœ€è¦æ‰§è¡Œæƒé™ï¼ˆxï¼‰æ‰èƒ½è¿›å…¥
- æ–‡ä»¶ä¸€èˆ¬ä¸éœ€è¦æ‰§è¡Œæƒé™
- è„šæœ¬æ–‡ä»¶æ‰éœ€è¦æ‰§è¡Œæƒé™
```

### 6.4 æƒé™é—®é¢˜æ’æŸ¥æ­¥éª¤



**ğŸ“ ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•**
```bash
# æ­¥éª¤1ï¼šæ£€æŸ¥MySQLæœåŠ¡ç”¨æˆ·

ps aux | grep mysqld
# æŸ¥çœ‹MySQLè¿›ç¨‹ä»¥ä»€ä¹ˆç”¨æˆ·è¿è¡Œï¼ˆé€šå¸¸æ˜¯mysqlï¼‰


# æ­¥éª¤2ï¼šæ£€æŸ¥æ–‡ä»¶æ‰€æœ‰æƒ

ls -la /etc/mysql/my.cnf
ls -la /var/lib/mysql/
ls -la /var/log/mysql/

# æ­¥éª¤3ï¼šæ£€æŸ¥MySQLç”¨æˆ·æ˜¯å¦å­˜åœ¨

id mysql
groups mysql

# æ­¥éª¤4ï¼šæµ‹è¯•æ–‡ä»¶è®¿é—®

sudo -u mysql cat /etc/mysql/my.cnf
# å¦‚æœæŠ¥æƒé™é”™è¯¯ï¼Œè¯´æ˜mysqlç”¨æˆ·æ— æ³•è¯»å–é…ç½®æ–‡ä»¶

```

**ğŸ”§ æƒé™ä¿®å¤å‘½ä»¤**
```bash
# ä¿®å¤é…ç½®æ–‡ä»¶æƒé™

sudo chown root:root /etc/mysql/my.cnf
sudo chmod 644 /etc/mysql/my.cnf

# ä¿®å¤æ•°æ®ç›®å½•æƒé™

sudo chown -R mysql:mysql /var/lib/mysql/
sudo chmod 750 /var/lib/mysql/
sudo chmod 660 /var/lib/mysql/*

# ä¿®å¤æ—¥å¿—æ–‡ä»¶æƒé™

sudo chown mysql:adm /var/log/mysql/error.log
sudo chmod 640 /var/log/mysql/error.log

# ä¿®å¤socketæ–‡ä»¶æƒé™ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

sudo chown mysql:mysql /var/run/mysqld/mysqld.sock
sudo chmod 777 /var/run/mysqld/mysqld.sock
```

### 6.5 ç‰¹æ®Šæƒé™é—®é¢˜å¤„ç†



**ğŸ” SELinuxæƒé™é—®é¢˜**
```bash
# æ£€æŸ¥SELinuxçŠ¶æ€

getenforce
# å¦‚æœè¾“å‡ºEnforcingï¼Œè¡¨ç¤ºSELinuxç”Ÿæ•ˆ


# æ£€æŸ¥MySQLç›¸å…³çš„SELinuxä¸Šä¸‹æ–‡

ls -Z /etc/mysql/my.cnf
ls -Z /var/lib/mysql/

# ä¿®å¤SELinuxä¸Šä¸‹æ–‡

sudo restorecon -R /etc/mysql/
sudo restorecon -R /var/lib/mysql/
sudo restorecon -R /var/log/mysql/

# å¦‚æœé—®é¢˜æŒç»­ï¼Œä¸´æ—¶å…³é—­SELinuxæµ‹è¯•

sudo setenforce 0
# å¯åŠ¨MySQLæµ‹è¯•

# å¦‚æœèƒ½å¯åŠ¨ï¼Œè¯´æ˜æ˜¯SELinuxé—®é¢˜

sudo setenforce 1  # é‡æ–°å¼€å¯
```

**ğŸ“ AppArmoræƒé™é—®é¢˜**
```bash
# æ£€æŸ¥AppArmorçŠ¶æ€

sudo aa-status | grep mysql

# æŸ¥çœ‹MySQLçš„AppArmoré…ç½®

sudo cat /etc/apparmor.d/usr.sbin.mysqld

# å¦‚æœæœ‰æƒé™é—®é¢˜ï¼Œå¯ä»¥ä¸´æ—¶è®¾ä¸ºcomplainæ¨¡å¼

sudo aa-complain /usr/sbin/mysqld

# æŸ¥çœ‹AppArmoræ—¥å¿—

sudo dmesg | grep -i apparmor
tail /var/log/syslog | grep -i apparmor
```

---

## 7. âŒ å‚æ•°ä¸ç”Ÿæ•ˆé—®é¢˜è¯Šæ–­



### 7.1 ä»€ä¹ˆæ˜¯å‚æ•°ä¸ç”Ÿæ•ˆé—®é¢˜



**é€šä¿—ç†è§£**ï¼šå°±åƒç”µè§†é¥æ§å™¨å¤±çµä¸€æ ·ï¼Œä½ æŒ‰äº†æŒ‰é’®ï¼ˆä¿®æ”¹äº†å‚æ•°ï¼‰ï¼Œä½†ç”µè§†æ²¡ååº”ï¼ˆå‚æ•°æ²¡ç”Ÿæ•ˆï¼‰ã€‚è¿™å¯èƒ½æ˜¯é¥æ§å™¨æ²¡ç”µï¼ˆé…ç½®æ–‡ä»¶æ²¡è¯»å–ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”µè§†åäº†ï¼ˆMySQLå†…éƒ¨é—®é¢˜ï¼‰ã€‚

```
å‚æ•°ä¸ç”Ÿæ•ˆçš„å¸¸è§è¡¨ç°ï¼š
è®¾ç½®ï¼šmax_connections = 2000
å®é™…ï¼šSELECT $$max_connections; æ˜¾ç¤ºè¿˜æ˜¯1000

å¯èƒ½åŸå› ï¼š
1. é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯ â†’ æ”¹é”™äº†æ–‡ä»¶
2. é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ â†’ MySQLè¯»ä¸æ‡‚
3. å‚æ•°è¢«è¦†ç›– â†’ å…¶ä»–åœ°æ–¹åˆè®¾ç½®äº†
4. å‚æ•°éœ€è¦é‡å¯ â†’ æ˜¯é™æ€å‚æ•°
5. æƒé™é—®é¢˜ â†’ æ–‡ä»¶è¯»ä¸äº†
```

### 7.2 å‚æ•°ä¸ç”Ÿæ•ˆçš„å¸¸è§åŸå› 



**ğŸ”¸ é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é—®é¢˜**
```bash
# MySQLè¯»å–é…ç½®æ–‡ä»¶çš„é¡ºåº

/etc/my.cnf
/etc/mysql/my.cnf
~/.my.cnf
--defaults-extra-file=æŒ‡å®šçš„æ–‡ä»¶

# é—®é¢˜ï¼šåœ¨ä½ä¼˜å…ˆçº§æ–‡ä»¶ä¸­è®¾ç½®å‚æ•°

# ä¿®æ”¹äº† /etc/my.cnfï¼Œä½† ~/.my.cnf ä¸­æœ‰åŒåå‚æ•°

# ç»“æœï¼šé«˜ä¼˜å…ˆçº§æ–‡ä»¶è¦†ç›–äº†ä½ä¼˜å…ˆçº§è®¾ç½®


# æ£€æŸ¥é…ç½®æ–‡ä»¶åŠ è½½é¡ºåº

mysqld --help --verbose | grep -A 1 "Default options"
```

**ğŸ”¸ å‚æ•°ä½œç”¨åŸŸé—®é¢˜**
```sql
-- é—®é¢˜ï¼šæ··æ·†äº†GLOBALå’ŒSESSIONä½œç”¨åŸŸ
-- é”™è¯¯è®¾ç½®ï¼šåªè®¾ç½®äº†SESSIONçº§åˆ«
SET SESSION max_connections = 2000;  # é”™è¯¯ï¼šmax_connectionsåªèƒ½æ˜¯GLOBAL

-- æ­£ç¡®è®¾ç½®ï¼šè®¾ç½®GLOBALçº§åˆ«
SET GLOBAL max_connections = 2000;   # æ­£ç¡®

-- æ£€æŸ¥ä¸åŒä½œç”¨åŸŸçš„å€¼
SELECT $$global.max_connections, $$session.max_connections;
```

**ğŸ”¸ å‚æ•°è¯­æ³•é”™è¯¯**
```ini
# é…ç½®æ–‡ä»¶ä¸­çš„é”™è¯¯ç¤ºä¾‹

[mysqld]
max_connections = 2000
max connections = 1500    # é”™è¯¯ï¼šå‚æ•°åæœ‰ç©ºæ ¼ï¼Œè¢«å¿½ç•¥
max_connections: 2000     # é”™è¯¯ï¼šç”¨äº†å†’å·ï¼Œè¢«å¿½ç•¥
max_connections 2000      # é”™è¯¯ï¼šç¼ºå°‘ç­‰å·ï¼Œè¢«å¿½ç•¥

# ç»“æœï¼šåªæœ‰ç¬¬ä¸€è¡Œç”Ÿæ•ˆï¼Œå…¶ä»–è¡Œè¢«å¿½ç•¥

```

### 7.3 å‚æ•°ç”Ÿæ•ˆçŠ¶æ€è¯Šæ–­



**ğŸ” æ£€æŸ¥å‚æ•°å½“å‰å€¼**
```sql
-- æ–¹æ³•1ï¼šæŸ¥çœ‹å‚æ•°å½“å‰å€¼
SHOW VARIABLES LIKE 'max_connections';
SELECT $$global.max_connections;

-- æ–¹æ³•2ï¼šæŸ¥çœ‹å‚æ•°æ¥æºï¼ˆMySQL 8.0+ï¼‰
SELECT VARIABLE_NAME, VARIABLE_VALUE, VARIABLE_SOURCE, VARIABLE_PATH
FROM performance_schema.variables_info 
WHERE VARIABLE_NAME = 'max_connections';

-- æ–¹æ³•3ï¼šæŸ¥çœ‹æ‰€æœ‰å˜é‡
SHOW GLOBAL VARIABLES;
```

**ğŸ“Š å¯¹æ¯”æœŸæœ›å€¼ä¸å®é™…å€¼**
```sql
-- åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯¹æ¯”æŸ¥è¯¢
SELECT 
  'max_connections' AS parameter_name,
  '2000' AS expected_value,
  $$global.max_connections AS actual_value,
  CASE 
    WHEN $$global.max_connections = 2000 THEN 'âœ“ æ­£ç¡®'
    ELSE 'âœ— ä¸åŒ¹é…' 
  END AS status;
```

### 7.4 å‚æ•°ä¸ç”Ÿæ•ˆçš„æ’æŸ¥æ­¥éª¤



**ğŸ“ ç³»ç»Ÿæ€§æ’æŸ¥æµç¨‹**
```bash
# æ­¥éª¤1ï¼šç¡®è®¤ä½¿ç”¨çš„é…ç½®æ–‡ä»¶

mysqld --print-defaults
# è¿™ä¼šæ˜¾ç¤ºMySQLå®é™…è¯»å–çš„æ‰€æœ‰é…ç½®


# æ­¥éª¤2ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•

mysqld --help --verbose > /dev/null
# å¦‚æœæœ‰è¯­æ³•é”™è¯¯ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯


# æ­¥éª¤3ï¼šç¡®è®¤é…ç½®æ–‡ä»¶è·¯å¾„

mysql --help | grep "Default options" -A 1
# æ˜¾ç¤ºMySQLæŸ¥æ‰¾é…ç½®æ–‡ä»¶çš„è·¯å¾„


# æ­¥éª¤4ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™

ls -la /etc/mysql/my.cnf
sudo -u mysql cat /etc/mysql/my.cnf
```

**ğŸ”§ é€æ­¥éªŒè¯æ–¹æ³•**
```bash
# éªŒè¯1ï¼šåˆ›å»ºä¸´æ—¶é…ç½®æ–‡ä»¶æµ‹è¯•

cat > /tmp/test.cnf << EOF
[mysqld]
max_connections = 3000
EOF

# ç”¨ä¸´æ—¶é…ç½®æ–‡ä»¶å¯åŠ¨MySQLæµ‹è¯•

mysqld --defaults-file=/tmp/test.cnf --user=mysql &

# éªŒè¯2ï¼šæ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

mysql -e "SELECT $$max_connections;"

# éªŒè¯3ï¼šæ¸…ç†æµ‹è¯•

killall mysqld
rm /tmp/test.cnf
```

### 7.5 å‚æ•°ä¸ç”Ÿæ•ˆçš„è§£å†³æ–¹æ¡ˆ



**ğŸ¯ æ ¹æ®åŸå› åˆ†åˆ«å¤„ç†**
```markdown
åŸå› 1ï¼šé…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯
è§£å†³ï¼šç¡®è®¤MySQLå®é™…è¯»å–çš„é…ç½®æ–‡ä»¶è·¯å¾„
å‘½ä»¤ï¼šmysqld --print-defaults
æ–¹æ¡ˆï¼šåœ¨æ­£ç¡®çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å‚æ•°

åŸå› 2ï¼šå‚æ•°è¢«å…¶ä»–æ–‡ä»¶è¦†ç›–
è§£å†³ï¼šæ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„é…ç½®æ–‡ä»¶
å‘½ä»¤ï¼šfind /etc -name "*.cnf" -exec grep -l "max_connections" {} \;
æ–¹æ¡ˆï¼šåˆ é™¤å†²çªçš„é…ç½®æˆ–è°ƒæ•´ä¼˜å…ˆçº§

åŸå› 3ï¼šå‚æ•°è¯­æ³•é”™è¯¯
è§£å†³ï¼šæ£€æŸ¥å‚æ•°åæ‹¼å†™å’Œæ ¼å¼
æ–¹æ¡ˆï¼šä½¿ç”¨æ­£ç¡®çš„è¯­æ³•é‡æ–°è®¾ç½®

åŸå› 4ï¼šå‚æ•°éœ€è¦é‡å¯
è§£å†³ï¼šé‡å¯MySQLæœåŠ¡
å‘½ä»¤ï¼šsudo systemctl restart mysql
```

**ğŸ“‹ å‚æ•°è®¾ç½®éªŒè¯æ¸…å•**
```sql
-- éªŒè¯æ¸…å•
-- âœ“ 1. ç¡®è®¤é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®
SHOW VARIABLES LIKE 'basedir';
SHOW VARIABLES LIKE 'datadir';

-- âœ“ 2. ç¡®è®¤å‚æ•°è¯­æ³•æ­£ç¡®
-- åœ¨é…ç½®æ–‡ä»¶ä¸­æ£€æŸ¥ç­‰å·ã€å‚æ•°åç­‰

-- âœ“ 3. ç¡®è®¤å‚æ•°ä½œç”¨åŸŸæ­£ç¡®
-- GLOBALå‚æ•°ç”¨SET GLOBALæˆ–é…ç½®æ–‡ä»¶
-- SESSIONå‚æ•°ç”¨SET SESSION

-- âœ“ 4. ç¡®è®¤å‚æ•°å€¼åˆæ³•
-- æ£€æŸ¥å‚æ•°èŒƒå›´å’Œæ•°æ®ç±»å‹

-- âœ“ 5. ç¡®è®¤ç”Ÿæ•ˆæ—¶æœº
-- é™æ€å‚æ•°éœ€è¦é‡å¯
-- åŠ¨æ€å‚æ•°ç«‹å³ç”Ÿæ•ˆ

-- âœ“ 6. ç¡®è®¤æ²¡æœ‰å†²çª
-- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–åœ°æ–¹è®¾ç½®äº†ç›¸åŒå‚æ•°
```

---

## 8. ğŸ”„ é…ç½®é‡è½½å¤±è´¥å¤„ç†



### 8.1 ä»€ä¹ˆæ˜¯é…ç½®é‡è½½



**é€šä¿—ç†è§£**ï¼šé…ç½®é‡è½½å°±åƒç»™æ‰‹æœº"é‡æ–°è¯»å–è®¾ç½®"ï¼Œä¸éœ€è¦å…³æœºé‡å¯ï¼Œåªæ˜¯è®©ç¨‹åºé‡æ–°è¯»ä¸€éé…ç½®æ–‡ä»¶ã€‚ä½†æœ‰æ—¶å€™è¿™ä¸ªè¿‡ç¨‹ä¼šå¤±è´¥ï¼Œå°±åƒæ‰‹æœºå¡ä½äº†è¯»ä¸äº†æ–°è®¾ç½®ã€‚

```
é…ç½®é‡è½½ç±»æ¯”ï¼š
æ­£å¸¸æƒ…å†µï¼š
ä¿®æ”¹é…ç½®æ–‡ä»¶ â†’ å‘é€é‡è½½å‘½ä»¤ â†’ MySQLé‡æ–°è¯»å– â†’ æ–°é…ç½®ç”Ÿæ•ˆ

é‡è½½å¤±è´¥ï¼š
ä¿®æ”¹é…ç½®æ–‡ä»¶ â†’ å‘é€é‡è½½å‘½ä»¤ â†’ MySQLè¯»å–å‡ºé”™ â†’ é…ç½®ä¸ç”Ÿæ•ˆ
```

### 8.2 é‡è½½å¤±è´¥çš„å¸¸è§åŸå› 



**ğŸ”¸ é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯**
```bash
# ç¤ºä¾‹ï¼šé…ç½®æ–‡ä»¶æœ‰è¯­æ³•é”™è¯¯

[mysqld]
max_connections = 2000
port = 3306
invalid-parameter-name = value    # æ— æ•ˆå‚æ•°å
max_connections = "too many"      # æ— æ•ˆå‚æ•°å€¼

# é‡è½½å‘½ä»¤

sudo systemctl reload mysql
# æˆ–

mysqladmin -u root -p flush-privileges

# ç»“æœï¼šé‡è½½å¤±è´¥ï¼Œé”™è¯¯æ—¥å¿—æ˜¾ç¤ºè¯­æ³•é”™è¯¯

```

**ğŸ”¸ æ–°é…ç½®ä¸è¿è¡ŒçŠ¶æ€å†²çª**
```sql
-- åœºæ™¯ï¼šå½“å‰æœ‰æ´»è·ƒè¿æ¥ï¼Œä½†è¦å‡å°‘æœ€å¤§è¿æ¥æ•°
-- å½“å‰çŠ¶æ€
SELECT $$max_connections;  -- å½“å‰å€¼ï¼š2000
SHOW STATUS LIKE 'Threads_connected';  -- å½“å‰è¿æ¥ï¼š1500

-- é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
max_connections = 1000  -- æ–°å€¼ï¼š1000

-- é‡è½½æ—¶å†²çªï¼šå½“å‰è¿æ¥æ•°(1500) > æ–°çš„æœ€å¤§è¿æ¥æ•°(1000)
-- ç»“æœï¼šé‡è½½å¯èƒ½å¤±è´¥æˆ–éƒ¨åˆ†ç”Ÿæ•ˆ
```

**ğŸ”¸ æƒé™å’Œæ–‡ä»¶è®¿é—®é—®é¢˜**
```bash
# é‡è½½è¿‡ç¨‹ä¸­MySQLéœ€è¦é‡æ–°è¯»å–é…ç½®æ–‡ä»¶

# å¦‚æœæƒé™æœ‰é—®é¢˜ï¼Œé‡è½½ä¼šå¤±è´¥


# æ£€æŸ¥æƒé™

ls -la /etc/mysql/my.cnf
# ç¡®ä¿mysqlç”¨æˆ·å¯ä»¥è¯»å–é…ç½®æ–‡ä»¶


# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«é”å®š

lsof /etc/mysql/my.cnf
```

### 8.3 é‡è½½å¤±è´¥çš„è¯Šæ–­æ–¹æ³•



**ğŸ“Š æ£€æŸ¥é‡è½½çŠ¶æ€**
```sql
-- æŸ¥çœ‹æœ€åä¸€æ¬¡é…ç½®åŠ è½½æ—¶é—´
SHOW STATUS LIKE 'Uptime';
SHOW VARIABLES LIKE 'version_compile_time';

-- æŸ¥çœ‹å½“å‰é…ç½®æ¥æºï¼ˆMySQL 8.0+ï¼‰
SELECT VARIABLE_NAME, VARIABLE_VALUE, VARIABLE_SOURCE 
FROM performance_schema.variables_info 
WHERE VARIABLE_SOURCE != 'COMPILED';

-- æ£€æŸ¥é”™è¯¯æ—¥å¿—
SHOW VARIABLES LIKE 'log_error';
```

**ğŸ” é”™è¯¯æ—¥å¿—åˆ†æ**
```bash
# æŸ¥çœ‹MySQLé”™è¯¯æ—¥å¿—

sudo tail -f /var/log/mysql/error.log

# å¸¸è§é‡è½½å¤±è´¥é”™è¯¯ä¿¡æ¯

[ERROR] [MY-000067] [Server] unknown variable 'invalid_param=value'
[ERROR] [MY-000068] [Server] option 'max_connections': signed value -100 adjusted to 1
[WARNING] [MY-013360] [Server] Plugin mysql_native_password reported: ''

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

journalctl -u mysql -f
sudo tail -f /var/log/syslog | grep mysql
```

### 8.4 é‡è½½æ–¹æ³•ä¸åŒºåˆ«



**ğŸ”„ ä¸åŒçš„é‡è½½æ–¹å¼**
```bash
# æ–¹æ³•1ï¼šsystemctl reloadï¼ˆæ¨èï¼‰

sudo systemctl reload mysql
# ä¼˜ç‚¹ï¼šå®‰å…¨ï¼Œä¸ä¼šæ–­å¼€ç°æœ‰è¿æ¥

# ç¼ºç‚¹ï¼šåªèƒ½é‡è½½éƒ¨åˆ†é…ç½®


# æ–¹æ³•2ï¼šå‘é€SIGHUPä¿¡å·

sudo kill -HUP $(pidof mysqld)
# ä¸systemctl reloadç±»ä¼¼


# æ–¹æ³•3ï¼šMySQLå‘½ä»¤é‡è½½

mysqladmin -u root -p flush-privileges
mysqladmin -u root -p refresh
# åªé‡è½½ç‰¹å®šå†…å®¹ï¼ˆå¦‚æƒé™è¡¨ï¼‰


# æ–¹æ³•4ï¼šå®Œå…¨é‡å¯ï¼ˆæœ€å½»åº•ï¼‰

sudo systemctl restart mysql
# ä¼˜ç‚¹ï¼šæ‰€æœ‰é…ç½®éƒ½ä¼šé‡æ–°åŠ è½½

# ç¼ºç‚¹ï¼šä¼šæ–­å¼€æ‰€æœ‰è¿æ¥ï¼Œå½±å“ä¸šåŠ¡

```

**ğŸ“‹ é‡è½½æ–¹å¼é€‰æ‹©æŒ‡å—**
```markdown
é€‰æ‹©reloadçš„æƒ…å†µï¼š
- ä¿®æ”¹äº†åŠ¨æ€å‚æ•°
- ä¸æƒ³æ–­å¼€ç”¨æˆ·è¿æ¥
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­

é€‰æ‹©restartçš„æƒ…å†µï¼š
- ä¿®æ”¹äº†é™æ€å‚æ•°ï¼ˆå¦‚portã€datadirï¼‰
- reloadå¤±è´¥çš„æƒ…å†µ
- æµ‹è¯•ç¯å¢ƒä¸­
- é‡å¤§é…ç½®æ›´æ”¹

ä½¿ç”¨flushå‘½ä»¤çš„æƒ…å†µï¼š
- åªæ˜¯æ›´æ–°äº†æƒé™
- åªæ˜¯æ¸…ç†äº†ç¼“å­˜
- ä¸æ¶‰åŠé…ç½®æ–‡ä»¶æ›´æ”¹
```

### 8.5 é‡è½½å¤±è´¥çš„è§£å†³æ–¹æ¡ˆ



**ğŸ”§ ç³»ç»Ÿæ€§è§£å†³æµç¨‹**
```bash
# æ­¥éª¤1ï¼šå¤‡ä»½å½“å‰é…ç½®

sudo cp /etc/mysql/my.cnf /etc/mysql/my.cnf.working

# æ­¥éª¤2ï¼šéªŒè¯æ–°é…ç½®è¯­æ³•

mysqld --help --verbose --defaults-file=/etc/mysql/my.cnf > /dev/null
echo $?  # è¿”å›0è¡¨ç¤ºé…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®

# æ­¥éª¤3ï¼šå°è¯•å®‰å…¨é‡è½½

sudo systemctl reload mysql
systemctl status mysql  # æ£€æŸ¥æœåŠ¡çŠ¶æ€

# æ­¥éª¤4ï¼šå¦‚æœé‡è½½å¤±è´¥ï¼Œå›æ»šé…ç½®

if [ $? -ne 0 ]; then
    echo "é‡è½½å¤±è´¥ï¼Œå›æ»šé…ç½®"
    sudo cp /etc/mysql/my.cnf.working /etc/mysql/my.cnf
    sudo systemctl reload mysql
fi
```

**ğŸ“ æ•…éšœæ’é™¤æ­¥éª¤**
```sql
-- è¯Šæ–­1ï¼šæ£€æŸ¥å½“å‰å‚æ•°çŠ¶æ€
SHOW VARIABLES LIKE 'max_connections';
SHOW STATUS LIKE 'Threads_connected';

-- è¯Šæ–­2ï¼šæŸ¥çœ‹é”™è¯¯ä¿¡æ¯
-- æ£€æŸ¥é”™è¯¯æ—¥å¿—æ–‡ä»¶

-- è¯Šæ–­3ï¼šæµ‹è¯•å‚æ•°å¯è¡Œæ€§
-- ä½¿ç”¨åŠ¨æ€è®¾ç½®æµ‹è¯•å‚æ•°æ˜¯å¦å¯è¡Œ
SET GLOBAL max_connections = 1500;
-- å¦‚æœåŠ¨æ€è®¾ç½®æˆåŠŸï¼Œè¯´æ˜å‚æ•°å€¼æ²¡é—®é¢˜

-- è¯Šæ–­4ï¼šé€ä¸ªå‚æ•°æµ‹è¯•
-- åˆ›å»ºæœ€å°é…ç½®æ–‡ä»¶ï¼Œé€ä¸ªæ·»åŠ å‚æ•°æµ‹è¯•
```

**ğŸ¯ é¢„é˜²é‡è½½å¤±è´¥çš„æªæ–½**
```markdown
é¢„é˜²æªæ–½1ï¼šé…ç½®æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†
- ä½¿ç”¨gitç®¡ç†é…ç½®æ–‡ä»¶
- æ¯æ¬¡ä¿®æ”¹å‰å…ˆå¤‡ä»½
- è®°å½•ä¿®æ”¹åŸå› å’Œæ—¶é—´

é¢„é˜²æªæ–½2ï¼šåˆ†é˜¶æ®µä¿®æ”¹
- ä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹å¤šä¸ªå‚æ•°
- ä¸€ä¸ªå‚æ•°ä¸€ä¸ªå‚æ•°åœ°ä¿®æ”¹å’Œæµ‹è¯•
- ç¡®è®¤ä¸€ä¸ªå‚æ•°ç”Ÿæ•ˆåå†ä¿®æ”¹ä¸‹ä¸€ä¸ª

é¢„é˜²æªæ–½3ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯
- åœ¨æµ‹è¯•ç¯å¢ƒå¤ç°ç”Ÿäº§é…ç½®
- å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ–°é…ç½®
- ç¡®è®¤æ— é—®é¢˜åå†åº”ç”¨åˆ°ç”Ÿäº§

é¢„é˜²æªæ–½4ï¼šç›‘æ§å’Œå‘Šè­¦
- è®¾ç½®é…ç½®é‡è½½å¤±è´¥çš„å‘Šè­¦
- ç›‘æ§å…³é”®å‚æ•°çš„å˜åŒ–
- å®šæœŸæ£€æŸ¥é…ç½®æ–‡ä»¶çš„ä¸€è‡´æ€§
```

---

## 9. ğŸ”„ å‚æ•°å…¼å®¹æ€§é—®é¢˜



### 9.1 ä»€ä¹ˆæ˜¯å‚æ•°å…¼å®¹æ€§é—®é¢˜



**é€šä¿—ç†è§£**ï¼šå°±åƒæ‰‹æœºAPPæ›´æ–°åï¼Œæœ‰äº›è€åŠŸèƒ½ä¸èƒ½ç”¨äº†ã€‚MySQLç‰ˆæœ¬å‡çº§æ—¶ï¼Œæœ‰äº›è€å‚æ•°å¯èƒ½è¢«åºŸå¼ƒï¼Œæœ‰äº›æ–°å‚æ•°å¯èƒ½ä¸è¢«è€ç‰ˆæœ¬æ”¯æŒï¼Œè¿™å°±æ˜¯å…¼å®¹æ€§é—®é¢˜ã€‚

```
å…¼å®¹æ€§é—®é¢˜ä¸¾ä¾‹ï¼š
MySQL 5.7 â†’ MySQL 8.0å‡çº§

åºŸå¼ƒçš„å‚æ•°ï¼š
query_cache_size        # æŸ¥è¯¢ç¼“å­˜åœ¨8.0ä¸­è¢«å®Œå…¨ç§»é™¤
sql_cache               # ç›¸å…³çš„SQLç¼“å­˜åŠŸèƒ½ä¹Ÿæ²¡äº†

æ–°å¢çš„å‚æ•°ï¼š
caching_sha2_password   # æ–°çš„å¯†ç è®¤è¯æ–¹å¼
innodb_dedicated_server # è‡ªåŠ¨é…ç½®å†…å­˜çš„å‚æ•°

ç»“æœï¼š
- è€é…ç½®æ–‡ä»¶åœ¨æ–°ç‰ˆæœ¬ä¸­å¯èƒ½æŠ¥é”™
- æ–°åŠŸèƒ½åœ¨è€ç‰ˆæœ¬ä¸­æ— æ³•ä½¿ç”¨
```

### 9.2 å¸¸è§å…¼å®¹æ€§é—®é¢˜ç±»å‹



**ğŸ”¸ å‚æ•°è¢«åºŸå¼ƒæˆ–ç§»é™¤**
```sql
-- MySQL 8.0ä¸­è¢«ç§»é™¤çš„å‚æ•°ç¤ºä¾‹
query_cache_type = 1           # 8.0ä¸­ä¸å†æ”¯æŒ
query_cache_size = 64M         # 8.0ä¸­ä¸å†æ”¯æŒ
query_cache_limit = 1M         # 8.0ä¸­ä¸å†æ”¯æŒ

-- å¯åŠ¨æ—¶ä¼šå‡ºç°é”™è¯¯ï¼š
[ERROR] unknown variable 'query_cache_type=1'

-- è§£å†³æ–¹æ¡ˆï¼šä»é…ç½®æ–‡ä»¶ä¸­åˆ é™¤è¿™äº›å‚æ•°
# æ³¨é‡Šæ‰æˆ–åˆ é™¤ç›¸å…³è¡Œ

# query_cache_type = 1

# query_cache_size = 64M

```

**ğŸ”¸ å‚æ•°é»˜è®¤å€¼å˜åŒ–**
```sql
-- MySQLç‰ˆæœ¬é—´é»˜è®¤å€¼çš„å˜åŒ–ç¤ºä¾‹
-- MySQL 5.7é»˜è®¤å€¼
sql_mode = ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION

-- MySQL 8.0é»˜è®¤å€¼
sql_mode = ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION

-- å˜åŒ–ï¼šç§»é™¤äº†NO_AUTO_CREATE_USER
-- å½±å“ï¼šå¯èƒ½å¯¼è‡´ä¸€äº›è€çš„SQLè¯­å¥è¡Œä¸ºä¸åŒ
```

**ğŸ”¸ å‚æ•°åç§°å˜åŒ–**
```sql
-- å‚æ•°é‡å‘½åç¤ºä¾‹
-- MySQL 5.7åŠæ›´æ—©ç‰ˆæœ¬
log_warnings = 2

-- MySQL 8.0
log_error_verbosity = 2  # æ–°åç§°

-- å…¼å®¹å¤„ç†ï¼š
-- æ–¹å¼1ï¼šä½¿ç”¨æ–°å‚æ•°å
log_error_verbosity = 2

-- æ–¹å¼2ï¼šæ¡ä»¶é…ç½®ï¼ˆåœ¨é…ç½®æ–‡ä»¶ä¸­ä¸å¤ªå¯è¡Œï¼‰
-- éœ€è¦åœ¨å¯åŠ¨è„šæœ¬ä¸­æ ¹æ®ç‰ˆæœ¬é€‰æ‹©å‚æ•°
```

### 9.3 å…¼å®¹æ€§é—®é¢˜æ£€æµ‹



**ğŸ” æ£€æŸ¥å½“å‰MySQLç‰ˆæœ¬**
```sql
-- æŸ¥çœ‹è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯
SELECT VERSION();
SHOW VARIABLES LIKE 'version%';

-- æŸ¥çœ‹ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯
SHOW VARIABLES LIKE 'version_compile%';
```

**ğŸ“Š æ£€æŸ¥åºŸå¼ƒå‚æ•°**
```bash
# æ–¹æ³•1ï¼šå¯åŠ¨æ—¶æ£€æŸ¥è­¦å‘Š

mysqld --help --verbose 2>&1 | grep -i warning
mysqld --help --verbose 2>&1 | grep -i deprecat

# æ–¹æ³•2ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­çš„å…¼å®¹æ€§è­¦å‘Š

grep -i "deprecat\|removed\|unknown" /var/log/mysql/error.log

# æ–¹æ³•3ï¼šä½¿ç”¨MySQLçš„é…ç½®æ£€æŸ¥å·¥å…·

mysqlcheck --check-upgrade --all-databases
```

**ğŸ“‹ å‚æ•°å…¼å®¹æ€§éªŒè¯è„šæœ¬**
```bash
#!/bin/bash

# æ£€æŸ¥MySQLé…ç½®å…¼å®¹æ€§è„šæœ¬


echo "å½“å‰MySQLç‰ˆæœ¬ï¼š"
mysql -e "SELECT VERSION();"

echo "æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­å¯èƒ½è¿‡æ—¶çš„å‚æ•°..."
grep -n "query_cache\|log_warnings\|innodb_additional_mem_pool_size" /etc/mysql/my.cnf

echo "æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•..."
mysqld --help --verbose --defaults-file=/etc/mysql/my.cnf > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ“ é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®"
else
    echo "âœ— é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥é”™è¯¯æ—¥å¿—"
fi
```

### 9.4 ç‰ˆæœ¬å‡çº§å…¼å®¹æ€§å¤„ç†



**ğŸ“ å‡çº§å‰çš„å‡†å¤‡å·¥ä½œ**
```bash
# æ­¥éª¤1ï¼šå¤‡ä»½å½“å‰é…ç½®

cp /etc/mysql/my.cnf /etc/mysql/my.cnf.pre-upgrade

# æ­¥éª¤2ï¼šæ£€æŸ¥MySQLç‰ˆæœ¬å‡çº§æ–‡æ¡£

# æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ä¸­çš„Breaking Changes


# æ­¥éª¤3ï¼šåˆ›å»ºå…¼å®¹æ€§æµ‹è¯•è„šæœ¬

cat > check_compat.sql << EOF
-- æ£€æŸ¥å¯èƒ½å—å½±å“çš„é…ç½®
SHOW VARIABLES LIKE 'query_cache%';
SHOW VARIABLES LIKE 'sql_mode';
SHOW VARIABLES LIKE 'log_warnings';
EOF

mysql < check_compat.sql > current_config.txt
```

**ğŸ”§ é…ç½®æ–‡ä»¶è¿ç§»**
```bash
# MySQL 5.7 åˆ° 8.0 çš„é…ç½®è¿ç§»ç¤ºä¾‹


# åŸé…ç½®æ–‡ä»¶ï¼ˆ5.7ï¼‰

cat > my.cnf.old << EOF
[mysqld]
query_cache_type = 1
query_cache_size = 64M
log_warnings = 2
sql_mode = STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER
EOF

# è¿ç§»åé…ç½®æ–‡ä»¶ï¼ˆ8.0ï¼‰

cat > my.cnf.new << EOF
[mysqld]
# query_cacheç›¸å…³å‚æ•°åœ¨8.0ä¸­å·²ç§»é™¤

# query_cache_type = 1      # å·²åºŸå¼ƒ

# query_cache_size = 64M    # å·²åºŸå¼ƒ


log_error_verbosity = 2     # æ›¿ä»£log_warnings
sql_mode = STRICT_TRANS_TABLES  # ç§»é™¤NO_AUTO_CREATE_USER
EOF
```

### 9.5 å…¼å®¹æ€§é—®é¢˜è§£å†³ç­–ç•¥



**ğŸ¯ åˆ†ç‰ˆæœ¬å¤„ç†ç­–ç•¥**
```markdown
ç­–ç•¥1ï¼šä¿å®ˆè¿ç§»
- åªä¿®æ”¹å¿…é¡»ä¿®æ”¹çš„å‚æ•°
- ä¿ç•™æ‰€æœ‰ä»ç„¶å…¼å®¹çš„å‚æ•°
- æ–°åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨

ç­–ç•¥2ï¼šæ¿€è¿›è¿ç§»
- é‡‡ç”¨æ–°ç‰ˆæœ¬çš„æ¨èé…ç½®
- å¯ç”¨æ–°ç‰ˆæœ¬çš„ä¼˜åŒ–åŠŸèƒ½
- å½»åº•æ¸…ç†åºŸå¼ƒå‚æ•°

ç­–ç•¥3ï¼šæ¸è¿›è¿ç§»
- åˆ†é˜¶æ®µæ›¿æ¢å‚æ•°
- æ¯æ¬¡åªæ”¹ä¸€éƒ¨åˆ†é…ç½®
- è§‚å¯Ÿç³»ç»Ÿç¨³å®šæ€§å†ç»§ç»­
```

**ğŸ“‹ å…¼å®¹æ€§å¤„ç†æ¸…å•**
```sql
-- æ£€æŸ¥æ¸…å•

-- âœ“ 1. ç¡®è®¤åºŸå¼ƒå‚æ•°
-- æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£çš„Removed Featuresåˆ—è¡¨

-- âœ“ 2. æ›¿æ¢é‡å‘½åå‚æ•°
-- log_warnings â†’ log_error_verbosity
-- innodb_additional_mem_pool_size â†’ åˆ é™¤ï¼ˆæ— éœ€æ›¿ä»£ï¼‰

-- âœ“ 3. æ£€æŸ¥é»˜è®¤å€¼å˜åŒ–
SHOW VARIABLES LIKE 'sql_mode';
-- ç¡®è®¤æ–°é»˜è®¤å€¼æ˜¯å¦é€‚åˆåº”ç”¨

-- âœ“ 4. æµ‹è¯•åº”ç”¨å…¼å®¹æ€§
-- è¿è¡Œåº”ç”¨çš„å›å½’æµ‹è¯•
-- æ£€æŸ¥æ—¥å¿—ä¸­çš„å…¼å®¹æ€§è­¦å‘Š

-- âœ“ 5. æ€§èƒ½åŸºå‡†æµ‹è¯•
-- å¯¹æ¯”å‡çº§å‰åçš„æ€§èƒ½æŒ‡æ ‡
-- ç¡®è®¤æ²¡æœ‰æ€§èƒ½é€€åŒ–
```

**ğŸ”„ å›æ»šè®¡åˆ’**
```bash
# å¦‚æœå‡çº§åå‘ç°å…¼å®¹æ€§é—®é¢˜ï¼Œå‡†å¤‡å›æ»šæ–¹æ¡ˆ


# ä¿å­˜å‡çº§å‰çš„å®Œæ•´ç¯å¢ƒä¿¡æ¯

mysqldump --all-databases > backup_before_upgrade.sql
tar -czf mysql_data_backup.tar.gz /var/lib/mysql/
cp /etc/mysql/my.cnf /etc/mysql/my.cnf.before-upgrade

# å›æ»šæ­¥éª¤

# 1. åœæ­¢MySQLæœåŠ¡

sudo systemctl stop mysql

# 2. æ¢å¤æ—§ç‰ˆæœ¬MySQLè½¯ä»¶

sudo apt remove mysql-server-8.0
sudo apt install mysql-server-5.7

# 3. æ¢å¤é…ç½®æ–‡ä»¶

sudo cp /etc/mysql/my.cnf.before-upgrade /etc/mysql/my.cnf

# 4. æ¢å¤æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰

sudo tar -xzf mysql_data_backup.tar.gz -C /

# 5. å¯åŠ¨æœåŠ¡

sudo systemctl start mysql
```

---

## 10. âš ï¸ å‚æ•°ä¼˜åŒ–å‰¯ä½œç”¨



### 10.1 ä»€ä¹ˆæ˜¯å‚æ•°ä¼˜åŒ–å‰¯ä½œç”¨



**é€šä¿—ç†è§£**ï¼šå°±åƒåƒè¯æ²»ç—…ä¸€æ ·ï¼Œä¼˜åŒ–MySQLå‚æ•°èƒ½æå‡æ€§èƒ½ï¼ˆæ²»ç—…ï¼‰ï¼Œä½†å¯èƒ½å¸¦æ¥å…¶ä»–é—®é¢˜ï¼ˆå‰¯ä½œç”¨ï¼‰ã€‚æ¯”å¦‚å¢å¤§ç¼“å†²æ± æå‡æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†ä¼šå ç”¨æ›´å¤šå†…å­˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå…¶ä»–ç¨‹åºè¿è¡Œç¼“æ…¢ã€‚

```
å‚æ•°ä¼˜åŒ–çš„å‰¯ä½œç”¨ç±»æ¯”ï¼š
ä¼˜åŒ–åŠ¨ä½œ = åƒè¯
æ­£é¢æ•ˆæœ = æ²»ç—…
å‰¯ä½œç”¨ = å¯èƒ½çš„ä¸è‰¯ååº”

ç¤ºä¾‹ï¼š
å¢å¤§innodb_buffer_pool_sizeï¼š
âœ“ æ­£é¢ï¼šæŸ¥è¯¢æ›´å¿«ï¼Œç¼“å­˜å‘½ä¸­ç‡é«˜
âœ— å‰¯ä½œç”¨ï¼šå ç”¨å¤§é‡å†…å­˜ï¼Œå…¶ä»–ç¨‹åºå¯ç”¨å†…å­˜å‡å°‘

å¢å¤§max_connectionsï¼š
âœ“ æ­£é¢ï¼šæ”¯æŒæ›´å¤šå¹¶å‘ç”¨æˆ·
âœ— å‰¯ä½œç”¨ï¼šæ¯ä¸ªè¿æ¥æ¶ˆè€—å†…å­˜ï¼Œæ€»å†…å­˜æ¶ˆè€—æ¿€å¢
```

### 10.2 å¸¸è§ä¼˜åŒ–å‚æ•°çš„å‰¯ä½œç”¨



**ğŸ”¸ å†…å­˜ç±»å‚æ•°çš„å‰¯ä½œç”¨**
```sql
-- å‚æ•°ï¼šinnodb_buffer_pool_size
-- ä¼˜åŒ–ç›®çš„ï¼šæé«˜InnoDBç¼“å­˜å‘½ä¸­ç‡
innodb_buffer_pool_size = 8G    # è®¾ç½®äº†8GBç¼“å†²æ± 

-- å‰¯ä½œç”¨åˆ†æï¼š
1. å†…å­˜æ¶ˆè€—ï¼šå ç”¨8GBç‰©ç†å†…å­˜
2. å¯åŠ¨æ—¶é—´ï¼šMySQLå¯åŠ¨å˜æ…¢ï¼ˆéœ€è¦åˆå§‹åŒ–8GBå†…å­˜ï¼‰
3. ç³»ç»Ÿå½±å“ï¼šå…¶ä»–ç¨‹åºå¯ç”¨å†…å­˜å‡å°‘
4. å´©æºƒæ¢å¤ï¼šå¦‚æœMySQLå¼‚å¸¸å…³é—­ï¼Œé‡å¯æ—¶é—´æ›´é•¿

-- å‰¯ä½œç”¨æ£€æµ‹ï¼š
SELECT 
    $$innodb_buffer_pool_size / 1024 / 1024 / 1024 AS buffer_pool_gb,
    (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX($$version_comment, ' ', 1), ' ', -1)) AS system_memory_status;

-- ç³»ç»Ÿå†…å­˜æ£€æŸ¥
SHOW ENGINE INNODB STATUS\G
```

**ğŸ”¸ è¿æ¥æ•°å‚æ•°çš„å‰¯ä½œç”¨**
```sql
-- å‚æ•°ï¼šmax_connections
-- ä¼˜åŒ–ç›®çš„ï¼šæ”¯æŒæ›´å¤šå¹¶å‘ç”¨æˆ·
max_connections = 5000    # æ”¯æŒ5000ä¸ªè¿æ¥

-- å‰¯ä½œç”¨åˆ†æï¼š
1. å†…å­˜æ¶ˆè€—ï¼šæ¯ä¸ªè¿æ¥æ¶ˆè€—çº¦256KB-8MBå†…å­˜
   æ€»æ¶ˆè€—ï¼š5000 Ã— 2MB â‰ˆ 10GBå†…å­˜
2. æ–‡ä»¶æè¿°ç¬¦ï¼šæ¯ä¸ªè¿æ¥éœ€è¦æ–‡ä»¶æè¿°ç¬¦
3. ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šè¿æ¥è¿‡å¤šå¯¼è‡´CPUä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€
4. é”ç«äº‰ï¼šæ›´å¤šè¿æ¥å¯èƒ½å¯¼è‡´é”ç­‰å¾…å¢åŠ 

-- å‰¯ä½œç”¨ç›‘æ§ï¼š
SHOW STATUS LIKE 'Threads_connected';    # å½“å‰è¿æ¥æ•°
SHOW STATUS LIKE 'Max_used_connections'; # å†å²æœ€å¤§è¿æ¥æ•°
SHOW STATUS LIKE 'Connection_errors%';   # è¿æ¥é”™è¯¯ç»Ÿè®¡
```

**ğŸ”¸ æ—¥å¿—ç±»å‚æ•°çš„å‰¯ä½œç”¨**
```sql
-- å‚æ•°ï¼šslow_query_log å’Œ long_query_time
-- ä¼˜åŒ–ç›®çš„ï¼šç›‘æ§æ…¢æŸ¥è¯¢
slow_query_log = ON
long_query_time = 0.1    # è®°å½•0.1ç§’ä»¥ä¸Šçš„æŸ¥è¯¢

-- å‰¯ä½œç”¨åˆ†æï¼š
1. ç£ç›˜IOï¼šé¢‘ç¹å†™å…¥æ…¢æŸ¥è¯¢æ—¥å¿—
2. å­˜å‚¨ç©ºé—´ï¼šæ—¥å¿—æ–‡ä»¶å¿«é€Ÿå¢é•¿
3. æ€§èƒ½å½±å“ï¼šè®°å½•æ—¥å¿—æœ¬èº«æœ‰æ€§èƒ½å¼€é”€
4. ç»´æŠ¤è´Ÿæ‹…ï¼šéœ€è¦å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶

-- å‰¯ä½œç”¨ç›‘æ§ï¼š
SHOW VARIABLES LIKE 'slow_query_log_file';
-- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°
-- ls -lh /var/lib/mysql/slow.log
```

### 10.3 å‰¯ä½œç”¨çš„è¯†åˆ«æ–¹æ³•



**ğŸ“Š ç³»ç»Ÿèµ„æºç›‘æ§**
```bash
# å†…å­˜ä½¿ç”¨ç›‘æ§

free -h
ps aux | grep mysqld | awk '{print $6}'  # MySQLå†…å­˜ä½¿ç”¨

# CPUä½¿ç”¨ç›‘æ§

top -p $(pidof mysqld)
iostat -x 1  # IOä½¿ç”¨æƒ…å†µ

# ç£ç›˜ç©ºé—´ç›‘æ§

df -h
du -sh /var/lib/mysql/  # MySQLæ•°æ®ç›®å½•å¤§å°
```

**ğŸ” MySQLå†…éƒ¨ç›‘æ§**
```sql
-- æ€§èƒ½ç›‘æ§æŸ¥è¯¢
SELECT 
    'Buffer Pool' AS metric,
    ROUND($$innodb_buffer_pool_size/1024/1024/1024, 2) AS allocated_gb,
    ROUND((SELECT COUNT(*) * $$innodb_page_size FROM information_schema.INNODB_BUFFER_PAGE) /1024/1024/1024, 2) AS used_gb;

-- è¿æ¥æ•°ç›‘æ§
SELECT 
    $$max_connections AS max_allowed,
    (SELECT COUNT(*) FROM information_schema.PROCESSLIST) AS current_connections,
    ROUND(((SELECT COUNT(*) FROM information_schema.PROCESSLIST) / $$max_connections) * 100, 2) AS usage_percent;

-- æ…¢æŸ¥è¯¢ç›‘æ§
SHOW STATUS LIKE 'Slow_queries';
SHOW STATUS LIKE 'Questions';
```

### 10.4 å‰¯ä½œç”¨çš„é¢„é˜²å’Œæ§åˆ¶



**ğŸ¯ å‚æ•°ä¼˜åŒ–çš„å®‰å…¨åŸåˆ™**
```markdown
åŸåˆ™1ï¼šæ¸è¿›å¼ä¼˜åŒ–
- æ¯æ¬¡åªè°ƒæ•´ä¸€ä¸ªå‚æ•°
- å°å¹…åº¦è°ƒæ•´ï¼Œè§‚å¯Ÿæ•ˆæœ
- ç¡®è®¤ç¨³å®šåå†ç»§ç»­ä¼˜åŒ–

åŸåˆ™2ï¼šç›‘æ§é©±åŠ¨ä¼˜åŒ–
- åŸºäºå®é™…ç›‘æ§æ•°æ®è°ƒæ•´
- è®¾ç½®æ€§èƒ½åŸºå‡†å¯¹æ¯”
- å…³æ³¨å…³é”®æŒ‡æ ‡å˜åŒ–

åŸåˆ™3ï¼šé¢„ç•™å®‰å…¨è¾¹ç•Œ
- ä¸è¦ç”¨æ»¡æ‰€æœ‰ç³»ç»Ÿèµ„æº
- ä¸ºç³»ç»Ÿå’Œå…¶ä»–ç¨‹åºé¢„ç•™èµ„æº
- è®¾ç½®åˆç†çš„ä¸Šé™å€¼

åŸåˆ™4ï¼šå»ºç«‹å›æ»šæœºåˆ¶
- è®°å½•æ¯æ¬¡å‚æ•°å˜æ›´
- ä¿ç•™ä¼˜åŒ–å‰çš„é…ç½®
- å‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ
```

**ğŸ“‹ å‰¯ä½œç”¨è¯„ä¼°æ¸…å•**
```sql
-- å†…å­˜å‰¯ä½œç”¨è¯„ä¼°
-- âœ“ æ£€æŸ¥ç³»ç»Ÿå¯ç”¨å†…å­˜
-- âœ“ è®¡ç®—MySQLæ€»å†…å­˜éœ€æ±‚
-- âœ“ ä¸ºOSå’Œå…¶ä»–ç¨‹åºé¢„ç•™30%å†…å­˜

-- CPUå‰¯ä½œç”¨è¯„ä¼°  
-- âœ“ ç›‘æ§CPUä½¿ç”¨ç‡å˜åŒ–
-- âœ“ æ£€æŸ¥ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç‡
-- âœ“ è§‚å¯ŸæŸ¥è¯¢å“åº”æ—¶é—´

-- ç£ç›˜å‰¯ä½œç”¨è¯„ä¼°
-- âœ“ ç›‘æ§ç£ç›˜IOè´Ÿè½½
-- âœ“ æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¢é•¿é€Ÿåº¦
-- âœ“ ç¡®ä¿ç£ç›˜ç©ºé—´å……è¶³

-- ç½‘ç»œå‰¯ä½œç”¨è¯„ä¼°
-- âœ“ ç›‘æ§ç½‘ç»œè¿æ¥æ•°
-- âœ“ æ£€æŸ¥ç½‘ç»œå¸¦å®½ä½¿ç”¨
-- âœ“ è§‚å¯Ÿè¿æ¥å»ºç«‹æ—¶é—´
```

### 10.5 å¸¸è§å‰¯ä½œç”¨çš„è§£å†³æ–¹æ¡ˆ



**ğŸ”§ å†…å­˜ä¸è¶³é—®é¢˜å¤„ç†**
```bash
# ç°è±¡ï¼šç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œå‡ºç°OOM

# åŸå› ï¼šMySQLå‚æ•°è®¾ç½®è¿‡å¤§


# è§£å†³æ­¥éª¤ï¼š

# 1. ç«‹å³æ£€æŸ¥å†…å­˜ä½¿ç”¨

free -h
ps aux --sort=-%mem | head

# 2. ä¸´æ—¶é™ä½MySQLå†…å­˜ä½¿ç”¨

mysql -u root -p -e "
SET GLOBAL innodb_buffer_pool_size = 1073741824;  -- é™è‡³1GB
SET GLOBAL max_connections = 100;                  -- é™ä½è¿æ¥æ•°
"

# 3. é‡æ–°è®¡ç®—åˆç†çš„å†…å­˜åˆ†é…

echo "ç³»ç»Ÿå†…å­˜ï¼š$(free -h | grep '^Mem' | awk '{print $2}')"
echo "MySQLå½“å‰ä½¿ç”¨ï¼š$(ps aux | grep mysqld | awk '{sum+=$6} END {print sum/1024 "MB"}')"

# 4. æ›´æ–°é…ç½®æ–‡ä»¶

cat >> /etc/mysql/my.cnf << EOF
# é‡æ–°è°ƒæ•´å†…å­˜å‚æ•°

innodb_buffer_pool_size = 1G    # ç³»ç»Ÿå†…å­˜çš„50-70%
max_connections = 200           # æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®
EOF
```

**âš¡ æ€§èƒ½ä¸‹é™é—®é¢˜å¤„ç†**
```sql
-- ç°è±¡ï¼šä¼˜åŒ–åæ€§èƒ½åè€Œä¸‹é™
-- å¯èƒ½åŸå› ï¼šå‚æ•°è®¾ç½®ä¸å½“æˆ–äº§ç”Ÿç“¶é¢ˆ

-- è¯Šæ–­æ­¥éª¤ï¼š
-- 1. å¯¹æ¯”ä¼˜åŒ–å‰åçš„æ€§èƒ½åŸºå‡†
SHOW STATUS LIKE 'Questions';           -- æŸ¥è¯¢æ€»æ•°
SHOW STATUS LIKE 'Uptime';              -- è¿è¡Œæ—¶é—´  
-- QPS = Questions / Uptime

-- 2. æ£€æŸ¥æ˜¯å¦å‡ºç°æ–°çš„ç“¶é¢ˆ
SHOW STATUS LIKE 'Innodb_buffer_pool_wait_free';  -- ç¼“å†²æ± ç­‰å¾…
SHOW STATUS LIKE 'Table_locks_waited';             -- è¡¨é”ç­‰å¾…
SHOW STATUS LIKE 'Innodb_row_lock_waits';         -- è¡Œé”ç­‰å¾…

-- 3. åˆ†ææ…¢æŸ¥è¯¢å˜åŒ–
SHOW STATUS LIKE 'Slow_queries';

-- 4. å›æ»šæœ‰é—®é¢˜çš„å‚æ•°
-- å°†å‚æ•°è°ƒå›ä¼˜åŒ–å‰çš„æ•°å€¼
SET GLOBAL innodb_buffer_pool_size = åŸæ¥çš„å€¼;
```

---

## 11. ğŸ’¾ é…ç½®æ–‡ä»¶å¤‡ä»½æ¢å¤



### 11.1 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®æ–‡ä»¶å¤‡ä»½



**é€šä¿—ç†è§£**ï¼šé…ç½®æ–‡ä»¶å°±åƒæˆ¿å­çš„é’¥åŒ™ï¼Œä¸¢äº†å°±è¿›ä¸äº†é—¨ã€‚MySQLé…ç½®æ–‡ä»¶ä¸€æ—¦æŸåæˆ–è¯¯ä¿®æ”¹ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®åº“æ— æ³•å¯åŠ¨ï¼Œä¸šåŠ¡ä¸­æ–­ã€‚å¤‡ä»½å°±æ˜¯ç»™è‡ªå·±å¤šé…å‡ æŠŠé’¥åŒ™ã€‚

```
é…ç½®æ–‡ä»¶å¤‡ä»½çš„é‡è¦æ€§ï¼š
æƒ…å†µ1ï¼šè¯¯åˆ é…ç½®æ–‡ä»¶ â†’ æ•°æ®åº“æ— æ³•å¯åŠ¨ â†’ ä¸šåŠ¡åœæ­¢
æƒ…å†µ2ï¼šé…ç½®é”™è¯¯å¯¼è‡´æ€§èƒ½é—®é¢˜ â†’ éœ€è¦å¿«é€Ÿå›æ»š
æƒ…å†µ3ï¼šå‡çº§å¤±è´¥éœ€è¦å›é€€ â†’ æ¢å¤åˆ°ç¨³å®šç‰ˆæœ¬é…ç½®
æƒ…å†µ4ï¼šå¤šç¯å¢ƒéƒ¨ç½² â†’ å¤ç”¨ç»è¿‡éªŒè¯çš„é…ç½®

å¤‡ä»½ç­–ç•¥ï¼š
- å®šæœŸè‡ªåŠ¨å¤‡ä»½ â†’ é˜²æ­¢é—å¿˜
- ç‰ˆæœ¬æ§åˆ¶ç®¡ç† â†’ è·Ÿè¸ªå˜æ›´å†å²  
- å¤šåœ°ç‚¹å­˜å‚¨ â†’ é˜²æ­¢å•ç‚¹æ•…éšœ
```

### 11.2 é…ç½®æ–‡ä»¶å¤‡ä»½ç­–ç•¥



**ğŸ“‹ å®Œæ•´å¤‡ä»½å†…å®¹æ¸…å•**
```bash
# MySQLé…ç½®ç›¸å…³æ–‡ä»¶æ¸…å•

/etc/mysql/my.cnf              # ä¸»é…ç½®æ–‡ä»¶
/etc/mysql/mysql.conf.d/       # é…ç½®æ–‡ä»¶ç›®å½•
/etc/mysql/conf.d/             # é¢å¤–é…ç½®ç›®å½•
~/.my.cnf                      # ç”¨æˆ·çº§é…ç½®æ–‡ä»¶
/var/lib/mysql/auto.cnf        # è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®

# ç³»ç»Ÿç›¸å…³æ–‡ä»¶

/etc/systemd/system/mysql.service    # ç³»ç»ŸæœåŠ¡é…ç½®
/etc/logrotate.d/mysql               # æ—¥å¿—è½®è½¬é…ç½®
/etc/apparmor.d/usr.sbin.mysqld      # å®‰å…¨ç­–ç•¥é…ç½®

# å¤‡ä»½è„šæœ¬ç¤ºä¾‹

#!/bin/bash

BACKUP_DIR="/backup/mysql-config"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_PATH="$BACKUP_DIR/mysql_config_$DATE"

mkdir -p $BACKUP_PATH

# å¤‡ä»½ä¸»è¦é…ç½®æ–‡ä»¶

cp /etc/mysql/my.cnf $BACKUP_PATH/
cp -r /etc/mysql/mysql.conf.d $BACKUP_PATH/
cp -r /etc/mysql/conf.d $BACKUP_PATH/

# å¤‡ä»½å½“å‰è¿è¡Œé…ç½®

mysqld --print-defaults > $BACKUP_PATH/current_config.txt
mysql -e "SHOW VARIABLES;" > $BACKUP_PATH/current_variables.txt

# æ‰“åŒ…å‹ç¼©

tar -czf $BACKUP_PATH.tar.gz -C $BACKUP_DIR mysql_config_$DATE
rm -rf $BACKUP_PATH

echo "é…ç½®å¤‡ä»½å®Œæˆï¼š$BACKUP_PATH.tar.gz"
```

**ğŸ“… è‡ªåŠ¨åŒ–å¤‡ä»½å®ç°**
```bash
# åˆ›å»ºå®šæ—¶å¤‡ä»½è„šæœ¬

cat > /usr/local/bin/mysql_config_backup.sh << 'EOF'
#!/bin/bash

# MySQLé…ç½®æ–‡ä»¶è‡ªåŠ¨å¤‡ä»½è„šæœ¬


BACKUP_BASE="/backup/mysql-config"
RETENTION_DAYS=30  # ä¿ç•™30å¤©çš„å¤‡ä»½
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•

mkdir -p $BACKUP_BASE

# å¤‡ä»½é…ç½®æ–‡ä»¶

backup_config() {
    local backup_name="mysql_config_$DATE"
    local backup_path="$BACKUP_BASE/$backup_name"
    
    mkdir -p $backup_path
    
#    # å¤åˆ¶é…ç½®æ–‡ä»¶
    [ -f /etc/mysql/my.cnf ] && cp /etc/mysql/my.cnf $backup_path/
    [ -d /etc/mysql/mysql.conf.d ] && cp -r /etc/mysql/mysql.conf.d $backup_path/
    [ -d /etc/mysql/conf.d ] && cp -r /etc/mysql/conf.d $backup_path/
    
#    # ä¿å­˜å½“å‰è¿è¡ŒçŠ¶æ€
    if mysqld --print-defaults > $backup_path/running_config.txt 2>/dev/null; then
        mysql -e "SHOW VARIABLES;" > $backup_path/variables.txt 2>/dev/null
        mysql -e "SHOW STATUS;" > $backup_path/status.txt 2>/dev/null
    fi
    
#    # æ·»åŠ å¤‡ä»½ä¿¡æ¯
    cat > $backup_path/backup_info.txt << EOL
å¤‡ä»½æ—¶é—´: $(date)
MySQLç‰ˆæœ¬: $(mysql --version)
ç³»ç»Ÿä¿¡æ¯: $(uname -a)
å¤‡ä»½åŸå› : å®šæ—¶è‡ªåŠ¨å¤‡ä»½
EOL
    
#    # å‹ç¼©å¤‡ä»½
    tar -czf $backup_path.tar.gz -C $BACKUP_BASE $backup_name
    rm -rf $backup_path
    
    echo "âœ“ å¤‡ä»½å®Œæˆ: $backup_path.tar.gz"
}

# æ¸…ç†è¿‡æœŸå¤‡ä»½

cleanup_old_backups() {
    find $BACKUP_BASE -name "mysql_config_*.tar.gz" -mtime +$RETENTION_DAYS -delete
    echo "âœ“ æ¸…ç†å®Œæˆ: åˆ é™¤äº†${RETENTION_DAYS}å¤©å‰çš„å¤‡ä»½"
}

# æ‰§è¡Œå¤‡ä»½

backup_config
cleanup_old_backups
EOF

# è®¾ç½®æƒé™

chmod +x /usr/local/bin/mysql_config_backup.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰

(crontab -l 2>/dev/null; echo "0 2 * * * /usr/local/bin/mysql_config_backup.sh") | crontab -
```

### 11.3 é…ç½®æ–‡ä»¶æ¢å¤æ–¹æ³•



**ğŸ”§ å¿«é€Ÿæ¢å¤æµç¨‹**
```bash
# æ¢å¤å‰çš„å‡†å¤‡å·¥ä½œ

# 1. åœæ­¢MySQLæœåŠ¡

sudo systemctl stop mysql

# 2. å¤‡ä»½å½“å‰é…ç½®ï¼ˆä»¥é˜²æ¢å¤å¤±è´¥ï¼‰

cp /etc/mysql/my.cnf /etc/mysql/my.cnf.before_restore.$(date +%Y%m%d_%H%M%S)

# 3. åˆ—å‡ºå¯ç”¨çš„å¤‡ä»½

ls -la /backup/mysql-config/mysql_config_*.tar.gz

# é€‰æ‹©è¦æ¢å¤çš„å¤‡ä»½ï¼ˆæŒ‰æ—¶é—´é€‰æ‹©ï¼‰

RESTORE_FILE="/backup/mysql-config/mysql_config_20241201_020001.tar.gz"

# 4. è§£å‹å¤‡ä»½æ–‡ä»¶

cd /tmp
tar -xzf $RESTORE_FILE

# 5. æ¢å¤é…ç½®æ–‡ä»¶

RESTORE_DIR="/tmp/mysql_config_20241201_020001"
sudo cp $RESTORE_DIR/my.cnf /etc/mysql/
sudo cp -r $RESTORE_DIR/mysql.conf.d/* /etc/mysql/mysql.conf.d/
sudo cp -r $RESTORE_DIR/conf.d/* /etc/mysql/conf.d/

# 6. æ£€æŸ¥æ–‡ä»¶æƒé™

sudo chown root:root /etc/mysql/my.cnf
sudo chmod 644 /etc/mysql/my.cnf

# 7. éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•

mysqld --help --verbose > /dev/null
if [ $? -eq 0 ]; then
    echo "âœ“ é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®"
else
    echo "âœ— é…ç½®æ–‡ä»¶æœ‰è¯­æ³•é”™è¯¯"
    exit 1
fi

# 8. å¯åŠ¨MySQLæœåŠ¡

sudo systemctl start mysql
sudo systemctl status mysql
```

**ğŸ“Š æ¢å¤æ•ˆæœéªŒè¯**
```sql
-- éªŒè¯æ¢å¤åçš„é…ç½®
-- 1. æ£€æŸ¥å…³é”®å‚æ•°æ˜¯å¦æ­£ç¡®
SELECT $$max_connections, $$innodb_buffer_pool_size, $$port;

-- 2. å¯¹æ¯”å¤‡ä»½æ—¶çš„é…ç½®
-- æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ä¸­çš„variables.txtï¼Œå¯¹æ¯”å½“å‰è®¾ç½®

-- 3. æ£€æŸ¥MySQLè¿è¡ŒçŠ¶æ€
SHOW STATUS LIKE 'Uptime';
SHOW STATUS LIKE 'Threads_connected';

-- 4. æµ‹è¯•åŸºæœ¬åŠŸèƒ½
USE mysql;
SHOW TABLES;
SELECT User FROM user LIMIT 1;
```

### 11.4 ç‰ˆæœ¬æ§åˆ¶ç®¡ç†



**ğŸ”„ ä½¿ç”¨Gitç®¡ç†é…ç½®æ–‡ä»¶**
```bash
# åˆå§‹åŒ–é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶

cd /etc/mysql
sudo git init
sudo git add my.cnf mysql.conf.d/ conf.d/
sudo git commit -m "åˆå§‹åŒ–MySQLé…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶"

# é…ç½®å¿½ç•¥æ–‡ä»¶

cat > .gitignore << EOF
# å¿½ç•¥ä¸´æ—¶æ–‡ä»¶

*.tmp
*.backup
*~

# å¿½ç•¥æ—¥å¿—æ–‡ä»¶

*.log

# å¿½ç•¥è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶

auto.cnf
EOF

# æ¯æ¬¡ä¿®æ”¹é…ç½®åæäº¤

modify_config_and_commit() {
    local commit_message="$1"
    local changed_files=$(git diff --name-only)
    
    if [ -n "$changed_files" ]; then
        echo "å‘ç°é…ç½®æ–‡ä»¶å˜æ›´: $changed_files"
        git add .
        git commit -m "$commit_message - $(date)"
        echo "âœ“ é…ç½®å˜æ›´å·²æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶"
    else
        echo "æ²¡æœ‰å‘ç°é…ç½®æ–‡ä»¶å˜æ›´"
    fi
}

# æŸ¥çœ‹é…ç½®å˜æ›´å†å²

git log --oneline --graph
git show HEAD  # æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡å˜æ›´
```

**ğŸ“ é…ç½®å˜æ›´æ–‡æ¡£åŒ–**
```bash
# åˆ›å»ºé…ç½®å˜æ›´è®°å½•æ¨¡æ¿

cat > /etc/mysql/CHANGELOG.md << 'EOF'
# MySQLé…ç½®å˜æ›´è®°å½•


# 2024-12-01


- **å˜æ›´å†…å®¹**: å¢å¤§innodb_buffer_pool_sizeä»1Gåˆ°2G
- **å˜æ›´åŸå› **: æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œå‡å°‘ç£ç›˜IO
- **å½±å“è¯„ä¼°**: å¢åŠ 1Gå†…å­˜ä½¿ç”¨ï¼Œé¢„æœŸæå‡20%æŸ¥è¯¢æ€§èƒ½
- **å›æ»šæ–¹æ¡ˆ**: æ¢å¤åˆ°1Gè®¾ç½®
- **éªŒè¯ç»“æœ**: æŸ¥è¯¢æ€§èƒ½æå‡15%ï¼Œå†…å­˜ä½¿ç”¨æ­£å¸¸

# 2024-11-25  


- **å˜æ›´å†…å®¹**: å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
- **å˜æ›´åŸå› **: ç›‘æ§å’Œä¼˜åŒ–æ…¢æŸ¥è¯¢
- **å½±å“è¯„ä¼°**: è½»å¾®å¢åŠ ç£ç›˜IOï¼Œæ—¥å¿—æ–‡ä»¶æ¯å¤©çº¦100MB
- **å›æ»šæ–¹æ¡ˆ**: å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—
- **éªŒè¯ç»“æœ**: æˆåŠŸè®°å½•æ…¢æŸ¥è¯¢ï¼Œè¯†åˆ«å‡º3ä¸ªéœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢
EOF
```

### 11.5 ç¾éš¾æ¢å¤é¢„æ¡ˆ



**ğŸš¨ ç´§æ€¥æ¢å¤åœºæ™¯å¤„ç†**
```bash
# åœºæ™¯1ï¼šé…ç½®æ–‡ä»¶å®Œå…¨ä¸¢å¤±

emergency_config_restore() {
    echo "ç´§æ€¥æƒ…å†µï¼šé…ç½®æ–‡ä»¶ä¸¢å¤±ï¼Œåˆ›å»ºæœ€å°å¯ç”¨é…ç½®"
    
    cat > /etc/mysql/my.cnf << 'EOF'
[mysqld]
# æœ€å°å¯ç”¨é…ç½®

datadir = /var/lib/mysql
socket = /var/run/mysqld/mysqld.sock
port = 3306
user = mysql

# åŸºæœ¬å®‰å…¨è®¾ç½®

bind-address = 127.0.0.1

# æœ€å°å†…å­˜è®¾ç½®ï¼ˆé€‚ç”¨äº1GBå†…å­˜ç³»ç»Ÿï¼‰

innodb_buffer_pool_size = 128M
max_connections = 100

# åŸºæœ¬æ—¥å¿—è®¾ç½®

log_error = /var/log/mysql/error.log

[mysql_safe]
socket = /var/run/mysqld/mysqld.sock
nice = 0

[mysql]
socket = /var/run/mysqld/mysqld.sock
EOF
    
#    # è®¾ç½®æƒé™
    chown root:root /etc/mysql/my.cnf
    chmod 644 /etc/mysql/my.cnf
    
    echo "âœ“ ç´§æ€¥é…ç½®æ–‡ä»¶å·²åˆ›å»ºï¼Œå°è¯•å¯åŠ¨MySQL"
    systemctl start mysql
}

# åœºæ™¯2ï¼šé…ç½®å¯¼è‡´MySQLæ— æ³•å¯åŠ¨

safe_mode_recovery() {
    echo "å®‰å…¨æ¨¡å¼æ¢å¤ï¼šè·³è¿‡å¯èƒ½æœ‰é—®é¢˜çš„é…ç½®"
    
#    # å¤‡ä»½å½“å‰é…ç½®
    cp /etc/mysql/my.cnf /etc/mysql/my.cnf.failed
    
#    # ä½¿ç”¨æœ€å°é…ç½®å¯åŠ¨
    mysqld_safe --defaults-file=/dev/null \
                --datadir=/var/lib/mysql \
                --socket=/tmp/mysql_recovery.sock \
                --pid-file=/tmp/mysql_recovery.pid &
    
    echo "âœ“ MySQLå·²åœ¨å®‰å…¨æ¨¡å¼å¯åŠ¨ï¼Œsocket: /tmp/mysql_recovery.sock"
    echo "ç°åœ¨å¯ä»¥è¿æ¥å¹¶è¯Šæ–­é—®é¢˜ï¼š"
    echo "mysql -S /tmp/mysql_recovery.sock -u root -p"
}
```

**ğŸ“‹ æ¢å¤éªŒè¯æ¸…å•**
```markdown
æ¢å¤åå¿…é¡»éªŒè¯çš„é¡¹ç›®ï¼š

âœ“ åŸºæœ¬è¿æ¥æµ‹è¯•
- mysql -u root -p èƒ½å¦æ­£å¸¸è¿æ¥
- ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

âœ“ å…³é”®é…ç½®éªŒè¯  
- æ•°æ®ç›®å½•è·¯å¾„æ­£ç¡®
- ç«¯å£è®¾ç½®æ­£ç¡®
- å†…å­˜å‚æ•°åˆç†

âœ“ å®‰å…¨è®¾ç½®æ£€æŸ¥
- rootå¯†ç ä»ç„¶æœ‰æ•ˆ
- ç”¨æˆ·æƒé™æ²¡æœ‰å˜åŒ–
- ç½‘ç»œç»‘å®šè®¾ç½®æ­£ç¡®

âœ“ æ€§èƒ½å‚æ•°éªŒè¯
- ç¼“å†²æ± å¤§å°åˆç†
- è¿æ¥æ•°é™åˆ¶åˆç†
- æ—¥å¿—è®¾ç½®æ­£ç¡®

âœ“ ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•
- åº”ç”¨èƒ½å¦æ­£å¸¸è¿æ¥
- æŸ¥è¯¢æ€§èƒ½æ˜¯å¦æ­£å¸¸
- æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
```

---

## 12. ğŸ“ˆ å‚æ•°å˜æ›´å½±å“åˆ†æ



### 12.1 ä»€ä¹ˆæ˜¯å‚æ•°å˜æ›´å½±å“åˆ†æ



**é€šä¿—ç†è§£**ï¼šå°±åƒè°ƒæ•´æ±½è½¦çš„å„ç§è®¾ç½®ä¸€æ ·ï¼Œæ”¹å˜MySQLå‚æ•°ä¼šäº§ç”Ÿè¿é”ååº”ã€‚æ¯”å¦‚ä½ è°ƒå¤§äº†ç©ºè°ƒåŠŸç‡ï¼Œå¯èƒ½åˆ¶å†·æ•ˆæœæ›´å¥½ï¼Œä½†ä¹Ÿä¼šå¢åŠ æ²¹è€—ã€‚å‚æ•°å˜æ›´å½±å“åˆ†æå°±æ˜¯é¢„æµ‹å’Œè¯„ä¼°è¿™äº›è¿é”ååº”ã€‚

```
å‚æ•°å˜æ›´çš„å½±å“é“¾ï¼š
è°ƒæ•´å‚æ•° â†’ ç›´æ¥å½±å“ â†’ é—´æ¥å½±å“ â†’ ç³»ç»Ÿæ•´ä½“å½±å“

ä¾‹å­ï¼šå¢å¤§innodb_buffer_pool_size
ç›´æ¥å½±å“ï¼šæ›´å¤šæ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­
é—´æ¥å½±å“ï¼šå‡å°‘ç£ç›˜IOï¼Œä½†å¢åŠ å†…å­˜ä½¿ç”¨
ç³»ç»Ÿå½±å“ï¼šæŸ¥è¯¢æ›´å¿«ï¼Œä½†å¯èƒ½å½±å“å…¶ä»–ç¨‹åº

åˆ†æç›®çš„ï¼š
- é¢„æµ‹æ€§èƒ½å˜åŒ–
- è¯„ä¼°èµ„æºæ¶ˆè€—
- é¿å…è´Ÿé¢å½±å“
- åˆ¶å®šç›‘æ§æŒ‡æ ‡
```

### 12.2 å‚æ•°å˜æ›´å½±å“åˆ†ç±»



**ğŸ”¸ æ€§èƒ½ç±»å½±å“**
```sql
-- ç¤ºä¾‹ï¼šè°ƒæ•´æŸ¥è¯¢ç¼“å­˜å¤§å°ï¼ˆMySQL 5.7åŠæ›´æ—©ç‰ˆæœ¬ï¼‰
-- å‚æ•°å˜æ›´
query_cache_size = 128M  # ä»64Må¢åŠ åˆ°128M

-- ç›´æ¥å½±å“åˆ†æ
1. ç¼“å­˜å‘½ä¸­ç‡å¯èƒ½æå‡
2. å†…å­˜ä½¿ç”¨å¢åŠ 64MB
3. æŸ¥è¯¢å“åº”æ—¶é—´å¯èƒ½å‡å°‘

-- é—´æ¥å½±å“åˆ†æ
1. ç¼“å­˜ç®¡ç†å¼€é”€å¢åŠ 
2. é”ç«äº‰å¯èƒ½å¢åŠ ï¼ˆå¤§å‹ç¼“å­˜ï¼‰
3. å†…å­˜ç¢ç‰‡å¯èƒ½å¢åŠ 

-- ç›‘æ§æŒ‡æ ‡
SHOW STATUS LIKE 'Qcache%';
-- Qcache_hitsï¼šç¼“å­˜å‘½ä¸­æ¬¡æ•°
-- Qcache_insertsï¼šç¼“å­˜æ’å…¥æ¬¡æ•°
-- Qcache_lowmem_prunesï¼šå› å†…å­˜ä¸è¶³æ¸…ç†çš„ç¼“å­˜é¡¹
```

**ğŸ”¸ ç¨³å®šæ€§ç±»å½±å“**
```sql
-- ç¤ºä¾‹ï¼šè°ƒæ•´æœ€å¤§è¿æ¥æ•°
-- å‚æ•°å˜æ›´
max_connections = 2000  # ä»1000å¢åŠ åˆ°2000

-- ç¨³å®šæ€§å½±å“åˆ†æï¼š
1. è¿æ¥å»ºç«‹å¤±è´¥ç‡å¯èƒ½é™ä½
2. å†…å­˜æ¶ˆè€—å¤§å¹…å¢åŠ ï¼ˆæ¯è¿æ¥çº¦2-8MBï¼‰
3. æ–‡ä»¶æè¿°ç¬¦éœ€æ±‚å¢åŠ 
4. CPUä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¢åŠ 

-- é£é™©è¯„ä¼°ï¼š
-- å†…å­˜é£é™©ï¼š2000 Ã— 4MB = 8GBé¢å¤–å†…å­˜éœ€æ±‚
-- ç³»ç»Ÿé£é™©ï¼šå¯èƒ½è¶…å‡ºulimité™åˆ¶
-- æ€§èƒ½é£é™©ï¼šè¿‡å¤šè¿æ¥å¯¼è‡´æ€§èƒ½ä¸‹é™

-- ç›‘æ§æŒ‡æ ‡ï¼š
SHOW STATUS LIKE 'Threads_connected';     -- å½“å‰è¿æ¥æ•°
SHOW STATUS LIKE 'Max_used_connections';  -- å†å²æœ€å¤§è¿æ¥æ•°
SHOW STATUS LIKE 'Connection_errors%';    -- è¿æ¥é”™è¯¯ç»Ÿè®¡
```

**ğŸ”¸ èµ„æºç±»å½±å“**
```sql
-- ç¤ºä¾‹ï¼šå¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—
-- å‚æ•°å˜æ›´
log_bin = ON
sync_binlog = 1

-- èµ„æºå½±å“åˆ†æï¼š
1. ç£ç›˜ç©ºé—´ï¼šæ—¥å¿—æ–‡ä»¶å¿«é€Ÿå¢é•¿
2. ç£ç›˜IOï¼šæ¯æ¬¡æäº¤éƒ½è¦å†™æ—¥å¿—
3. CPUå¼€é”€ï¼šæ—¥å¿—æ ¼å¼åŒ–å’Œå†™å…¥
4. ç½‘ç»œå¸¦å®½ï¼šä¸»ä»å¤åˆ¶æ—¶å¢åŠ ç½‘ç»œæµé‡

-- å®¹é‡è§„åˆ’ï¼š
-- é¢„ä¼°æ—¥å¿—å¢é•¿ï¼šæ¯å¤©çº¦æ•°æ®å˜æ›´é‡çš„1.5-2å€
-- ç£ç›˜IOå¢åŠ ï¼šæ¯ä¸ªäº‹åŠ¡é¢å¤–1-2æ¬¡ç£ç›˜å†™å…¥
-- ç½‘ç»œæµé‡ï¼šä»åº“æ•°é‡ Ã— æ—¥å¿—æ•°æ®é‡

-- ç›‘æ§æŒ‡æ ‡ï¼š
SHOW BINARY LOGS;                    -- æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶
SHOW STATUS LIKE 'Binlog_cache%';    -- äºŒè¿›åˆ¶æ—¥å¿—ç¼“å­˜çŠ¶æ€
```

### 12.3 å½±å“åˆ†ææ–¹æ³•



**ğŸ“Š åŸºå‡†æµ‹è¯•å¯¹æ¯”æ³•**
```bash
# å»ºç«‹åŸºå‡†æµ‹è¯•æ¡†æ¶

create_baseline() {
    echo "å»ºç«‹å‚æ•°å˜æ›´å‰çš„æ€§èƒ½åŸºå‡†"
    
#    # æ€§èƒ½æŒ‡æ ‡æ”¶é›†
    mysql -e "
    SELECT 
        'QPS' AS metric, 
        VARIABLE_VALUE / (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME='Uptime') AS value
    FROM information_schema.GLOBAL_STATUS 
    WHERE VARIABLE_NAME='Questions'
    UNION ALL
    SELECT 'è¿æ¥æ•°', $$max_connections
    UNION ALL  
    SELECT 'ç¼“å†²æ± å‘½ä¸­ç‡', 
        (1 - (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME='Innodb_buffer_pool_reads') / 
             (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME='Innodb_buffer_pool_read_requests')) * 100;
    " > baseline_before.txt
    
#    # ç³»ç»Ÿèµ„æºåŸºå‡†
    echo "=== ç³»ç»Ÿèµ„æºåŸºå‡† ===" >> baseline_before.txt
    free -h >> baseline_before.txt
    iostat -x 1 3 >> baseline_before.txt
    
    echo "âœ“ åŸºå‡†æ•°æ®å·²ä¿å­˜åˆ° baseline_before.txt"
}

# å˜æ›´åå¯¹æ¯”æµ‹è¯•

compare_after_change() {
    echo "æ”¶é›†å‚æ•°å˜æ›´åçš„æ€§èƒ½æ•°æ®"
    
#    # ç­‰å¾…ç³»ç»Ÿç¨³å®š
    sleep 60
    
#    # æ”¶é›†ç›¸åŒæŒ‡æ ‡
    mysql -e "
    [åŒæ ·çš„æŸ¥è¯¢è¯­å¥]
    " > baseline_after.txt
    
#    # å¯¹æ¯”åˆ†æ
    echo "=== æ€§èƒ½å¯¹æ¯”åˆ†æ ===" > performance_comparison.txt
    echo "å˜æ›´æ—¶é—´: $(date)" >> performance_comparison.txt
    echo "å˜æ›´å†…å®¹: [è®°å½•å…·ä½“å˜æ›´]" >> performance_comparison.txt
    
#    # è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªåŠ¨å¯¹æ¯”é€»è¾‘
    diff baseline_before.txt baseline_after.txt >> performance_comparison.txt
    
    echo "âœ“ æ€§èƒ½å¯¹æ¯”å®Œæˆï¼Œç»“æœä¿å­˜åˆ° performance_comparison.txt"
}
```

**ğŸ” å®æ—¶ç›‘æ§åˆ†ææ³•**
```sql
-- åˆ›å»ºå‚æ•°å˜æ›´ç›‘æ§è§†å›¾
CREATE OR REPLACE VIEW parameter_impact_monitor AS
SELECT 
    'QPS' AS metric,
    ROUND(Questions.value / Uptime.value, 2) AS current_value,
    'æŸ¥è¯¢/ç§’' AS unit
FROM 
    (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Questions') Questions,
    (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Uptime') Uptime
UNION ALL
SELECT 
    'è¿æ¥ä½¿ç”¨ç‡',
    ROUND((Threads_connected.value / $$max_connections) * 100, 2),
    '%'
FROM 
    (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Threads_connected') Threads_connected
UNION ALL
SELECT 
    'ç¼“å†²æ± å‘½ä¸­ç‡',
    ROUND((1 - Pool_reads.value / Pool_read_requests.value) * 100, 2),
    '%'
FROM 
    (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Innodb_buffer_pool_reads') Pool_reads,
    (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Innodb_buffer_pool_read_requests') Pool_read_requests;

-- å®šæœŸæŸ¥è¯¢ç›‘æ§æ•°æ®
SELECT * FROM parameter_impact_monitor;
```

### 12.4 å½±å“è¯„ä¼°æ¨¡å‹



**ğŸ“‹ å½±å“è¯„ä¼°çŸ©é˜µ**
```markdown
å‚æ•°å˜æ›´å½±å“è¯„ä¼°è¡¨æ ¼ï¼š

| å½±å“ç»´åº¦ | æƒé‡ | å˜æ›´å‰ | å˜æ›´å | å½±å“åº¦ | é£é™©çº§åˆ« |
|----------|------|--------|--------|--------|----------|
| æŸ¥è¯¢æ€§èƒ½ | é«˜   | 100QPS | 120QPS | +20%   | ä½       |
| å†…å­˜ä½¿ç”¨ | é«˜   | 2GB    | 4GB    | +100%  | ä¸­       |
| ç£ç›˜IO   | ä¸­   | 80%    | 60%    | -25%   | ä½       |
| è¿æ¥ç¨³å®š | é«˜   | 99.9%  | 99.9%  | 0%     | ä½       |
| å¯åŠ¨æ—¶é—´ | ä½   | 30ç§’   | 45ç§’   | +50%   | ä½       |

å½±å“åº¦è®¡ç®—ï¼š(å˜æ›´å - å˜æ›´å‰) / å˜æ›´å‰ Ã— 100%
é£é™©çº§åˆ«ï¼šé«˜å½±å“+é«˜æƒé‡=é«˜é£é™©
```

**ğŸ¯ å†³ç­–æ”¯æŒæ¡†æ¶**
```markdown
å‚æ•°å˜æ›´å†³ç­–æ¡†æ¶ï¼š

æ­¥éª¤1ï¼šæ”¶ç›Šåˆ†æ
- é¢„æœŸæ€§èƒ½æå‡ï¼šé‡åŒ–æŒ‡æ ‡æ”¹å–„
- ä¸šåŠ¡ä»·å€¼ï¼šå¯¹ç”¨æˆ·ä½“éªŒçš„æ”¹å–„
- æŠ€æœ¯å€ºåŠ¡ï¼šè§£å†³çš„æŠ€æœ¯é—®é¢˜

æ­¥éª¤2ï¼šæˆæœ¬åˆ†æ  
- èµ„æºæˆæœ¬ï¼šå¢åŠ çš„ç¡¬ä»¶èµ„æºæ¶ˆè€—
- ç»´æŠ¤æˆæœ¬ï¼šå¢åŠ çš„è¿ç»´å¤æ‚åº¦
- é£é™©æˆæœ¬ï¼šæ½œåœ¨æ•…éšœçš„å½±å“

æ­¥éª¤3ï¼šé£é™©è¯„ä¼°
- æŠ€æœ¯é£é™©ï¼šå‚æ•°å†²çªã€ç¨³å®šæ€§é—®é¢˜
- ä¸šåŠ¡é£é™©ï¼šå¯¹ä¸šåŠ¡è¿ç»­æ€§çš„å½±å“
- å›æ»šé£é™©ï¼šæ¢å¤çš„éš¾åº¦å’Œæ—¶é—´

æ­¥éª¤4ï¼šå®æ–½ç­–ç•¥
- æ¸è¿›å¼ï¼šåˆ†é˜¶æ®µå°å¹…è°ƒæ•´
- æ¿€è¿›å¼ï¼šä¸€æ¬¡æ€§å¤§å¹…è°ƒæ•´  
- A/Bæµ‹è¯•ï¼šéƒ¨åˆ†æµé‡æµ‹è¯•

å†³ç­–çŸ©é˜µï¼š
é«˜æ”¶ç›Š + ä½é£é™© = ç«‹å³æ‰§è¡Œ
é«˜æ”¶ç›Š + é«˜é£é™© = è°¨æ…æ‰§è¡Œï¼Œå……åˆ†æµ‹è¯•
ä½æ”¶ç›Š + ä½é£é™© = å¯é€‰æ‰§è¡Œ
ä½æ”¶ç›Š + é«˜é£é™© = ä¸å»ºè®®æ‰§è¡Œ
```

### 12.5 é•¿æœŸå½±å“è·Ÿè¸ª



**ğŸ“ˆ å»ºç«‹é•¿æœŸç›‘æ§æœºåˆ¶**
```bash
# åˆ›å»ºé•¿æœŸå½±å“è·Ÿè¸ªè„šæœ¬

cat > /usr/local/bin/parameter_impact_tracker.sh << 'EOF'
#!/bin/bash

# MySQLå‚æ•°å˜æ›´é•¿æœŸå½±å“è·Ÿè¸ª


LOG_FILE="/var/log/mysql/parameter_impact.log"
DATE=$(date '+%Y-%m-%d %H:%M:%S')

# æ”¶é›†å…³é”®æŒ‡æ ‡

collect_metrics() {
    echo "[$DATE] === å‚æ•°å½±å“è·Ÿè¸ª ===" >> $LOG_FILE
    
#    # æ€§èƒ½æŒ‡æ ‡
    mysql -e "
    SELECT 
        '$DATE' AS timestamp,
        'QPS' AS metric,
        ROUND(Questions.value / Uptime.value, 2) AS value
    FROM 
        (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Questions') Questions,
        (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Uptime') Uptime;
    " >> $LOG_FILE
    
#    # èµ„æºä½¿ç”¨
    echo "å†…å­˜ä½¿ç”¨: $(free | grep '^Mem' | awk '{printf "%.1f%%", $3/$2 * 100.0}')" >> $LOG_FILE
    echo "CPUä½¿ç”¨: $(top -bn1 | grep 'Cpu(s)' | awk '{print $2}' | cut -d'%' -f1)" >> $LOG_FILE
    
#    # é”™è¯¯ç»Ÿè®¡
    mysql -e "SHOW STATUS LIKE 'Aborted_connects';" | tail -1 >> $LOG_FILE
    
    echo "" >> $LOG_FILE
}

# æ‰§è¡Œæ”¶é›†

collect_metrics
EOF

chmod +x /usr/local/bin/parameter_impact_tracker.sh

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡

(crontab -l 2>/dev/null; echo "0 * * * * /usr/local/bin/parameter_impact_tracker.sh") | crontab -
```

**ğŸ“Š å½±å“è¶‹åŠ¿åˆ†æ**
```sql
-- åˆ›å»ºå‚æ•°å˜æ›´å†å²è®°å½•è¡¨ï¼ˆå¦‚æœæœ‰å†å²æ•°æ®æ”¶é›†ï¼‰
CREATE TABLE IF NOT EXISTS parameter_change_log (
    id INT AUTO_INCREMENT PRIMARY KEY,
    change_date DATETIME,
    parameter_name VARCHAR(100),
    old_value VARCHAR(200),
    new_value VARCHAR(200),
    change_reason TEXT,
    expected_impact TEXT,
    actual_impact TEXT,
    performance_change DECIMAL(5,2),  -- æ€§èƒ½å˜åŒ–ç™¾åˆ†æ¯”
    rollback_date DATETIME DEFAULT NULL
);

-- åˆ†æå‚æ•°å˜æ›´çš„é•¿æœŸæ•ˆæœ
SELECT 
    parameter_name,
    COUNT(*) AS change_count,
    AVG(performance_change) AS avg_performance_impact,
    COUNT(CASE WHEN rollback_date IS NOT NULL THEN 1 END) AS rollback_count,
    (COUNT(CASE WHEN rollback_date IS NOT NULL THEN 1 END) / COUNT(*)) * 100 AS rollback_rate
FROM parameter_change_log 
WHERE change_date >= DATE_SUB(NOW(), INTERVAL 6 MONTH)
GROUP BY parameter_name
ORDER BY avg_performance_impact DESC;
```

---

## 13. âœ… é…ç½®éªŒè¯æ–¹æ³•



### 13.1 ä»€ä¹ˆæ˜¯é…ç½®éªŒè¯



**é€šä¿—ç†è§£**ï¼šé…ç½®éªŒè¯å°±åƒè€ƒè¯•å‰çš„æ£€æŸ¥ï¼Œç¡®ä¿æ‰€æœ‰ç­”æ¡ˆéƒ½å¡«å¯¹äº†ã€‚MySQLé…ç½®éªŒè¯æ˜¯ç¡®ä¿é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®ã€å‚æ•°å€¼åˆç†ã€ä¸ä¼šå¯¼è‡´å¯åŠ¨å¤±è´¥æˆ–è¿è¡Œé—®é¢˜çš„è¿‡ç¨‹ã€‚

```
é…ç½®éªŒè¯çš„å±‚æ¬¡ï¼š
è¯­æ³•éªŒè¯ â†’ ç¡®ä¿é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ŒMySQLèƒ½è¯»æ‡‚
é€»è¾‘éªŒè¯ â†’ ç¡®ä¿å‚æ•°å€¼åˆç†ï¼Œä¸ä¼šå¯¼è‡´å†²çª
åŠŸèƒ½éªŒè¯ â†’ ç¡®ä¿é…ç½®ç”Ÿæ•ˆï¼ŒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
æ€§èƒ½éªŒè¯ â†’ ç¡®ä¿é…ç½®å¸¦æ¥é¢„æœŸçš„æ€§èƒ½æ”¹å–„

éªŒè¯çš„é‡è¦æ€§ï¼š
- é¿å…é…ç½®é”™è¯¯å¯¼è‡´MySQLæ— æ³•å¯åŠ¨
- æå‰å‘ç°å‚æ•°å†²çªå’Œä¸åˆç†è®¾ç½®
- ç¡®ä¿é…ç½®å˜æ›´è¾¾åˆ°é¢„æœŸæ•ˆæœ
- å‡å°‘ç”Ÿäº§ç¯å¢ƒæ•…éšœé£é™©
```

### 13.2 è¯­æ³•éªŒè¯æ–¹æ³•



**ğŸ” é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨mysqldå‘½ä»¤éªŒè¯è¯­æ³•

validate_config_syntax() {
    local config_file=${1:-"/etc/mysql/my.cnf"}
    
    echo "éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•: $config_file"
    
#    # ä½¿ç”¨mysqld --helpéªŒè¯é…ç½®
    if mysqld --help --verbose --defaults-file="$config_file" > /dev/null 2>&1; then
        echo "âœ“ é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®"
        return 0
    else
        echo "âœ— é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯:"
        mysqld --help --verbose --defaults-file="$config_file" 2>&1 | grep -i error
        return 1
    fi
}

# æ–¹æ³•2ï¼šé€æ®µéªŒè¯é…ç½®æ–‡ä»¶

validate_config_sections() {
    local config_file="/etc/mysql/my.cnf"
    
    echo "æ£€æŸ¥é…ç½®æ–‡ä»¶å„éƒ¨åˆ†..."
    
#    # æ£€æŸ¥ç« èŠ‚æ ‡è®°
    if grep -q "^\[.*\]$" "$config_file"; then
        echo "âœ“ æ‰¾åˆ°é…ç½®ç« èŠ‚"
        grep "^\[.*\]$" "$config_file"
    else
        echo "âœ— æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„é…ç½®ç« èŠ‚"
    fi
    
#    # æ£€æŸ¥å‚æ•°æ ¼å¼
    echo "æ£€æŸ¥å‚æ•°æ ¼å¼..."
    while IFS= read -r line; do
#        # å¿½ç•¥ç©ºè¡Œå’Œæ³¨é‡Š
        [[ -z "$line" || "$line" =~ ^[[:space:]]*# ]] && continue
#        # å¿½ç•¥ç« èŠ‚æ ‡è®°
        [[ "$line" =~ ^\[.*\]$ ]] && continue
        
#        # æ£€æŸ¥å‚æ•°æ ¼å¼ï¼ˆåº”è¯¥åŒ…å«ç­‰å·ï¼‰
        if ! [[ "$line" =~ ^[[:space:]]*[a-zA-Z_][a-zA-Z0-9_-]*[[:space:]]*=[[:space:]]*.*$ ]]; then
            echo "âœ— å¯èƒ½çš„æ ¼å¼é”™è¯¯: $line"
        fi
    done < "$config_file"
}

# è¿è¡ŒéªŒè¯

validate_config_syntax
validate_config_sections
```

**ğŸ“‹ å¸¸è§è¯­æ³•é”™è¯¯æ£€æŸ¥æ¸…å•**
```bash
# åˆ›å»ºè¯­æ³•æ£€æŸ¥è„šæœ¬

check_common_syntax_errors() {
    local config_file="/etc/mysql/my.cnf"
    local error_count=0
    
    echo "=== MySQLé…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥ ==="
    
#    # æ£€æŸ¥1ï¼šç« èŠ‚æ ‡è®°æ˜¯å¦å®Œæ•´
    echo "æ£€æŸ¥ç« èŠ‚æ ‡è®°..."
    if grep -n "^\[[^]]*$" "$config_file"; then
        echo "âœ— å‘ç°ä¸å®Œæ•´çš„ç« èŠ‚æ ‡è®°ï¼ˆç¼ºå°‘å³æ‹¬å·ï¼‰"
        ((error_count++))
    fi
    
#    # æ£€æŸ¥2ï¼šå‚æ•°åæ˜¯å¦åŒ…å«ç©ºæ ¼
    echo "æ£€æŸ¥å‚æ•°åæ ¼å¼..."
    if grep -n "^[[:space:]]*[a-zA-Z_][a-zA-Z0-9_-]* [a-zA-Z_].*=" "$config_file"; then
        echo "âœ— å‘ç°å‚æ•°ååŒ…å«ç©ºæ ¼"
        grep -n "^[[:space:]]*[a-zA-Z_][a-zA-Z0-9_-]* [a-zA-Z_].*=" "$config_file"
        ((error_count++))
    fi
    
#    # æ£€æŸ¥3ï¼šæ˜¯å¦ä½¿ç”¨äº†é”™è¯¯çš„åˆ†éš”ç¬¦
    echo "æ£€æŸ¥å‚æ•°åˆ†éš”ç¬¦..."
    if grep -n "^[[:space:]]*[a-zA-Z_][a-zA-Z0-9_-]*[[:space:]]*:" "$config_file"; then
        echo "âœ— å‘ç°ä½¿ç”¨å†’å·(:)ä½œä¸ºåˆ†éš”ç¬¦ï¼Œåº”è¯¥ä½¿ç”¨ç­‰å·(=)"
        grep -n "^[[:space:]]*[a-zA-Z_][a-zA-Z0-9_-]*[[:space:]]*:" "$config_file"
        ((error_count++))
    fi
    
#    # æ£€æŸ¥4ï¼šé‡å¤çš„å‚æ•°å®šä¹‰
    echo "æ£€æŸ¥é‡å¤å‚æ•°..."
    duplicates=$(grep -v "^[[:space:]]*#" "$config_file" | grep "=" | cut -d'=' -f1 | sort | uniq -d)
    if [ -n "$duplicates" ]; then
        echo "âœ— å‘ç°é‡å¤å®šä¹‰çš„å‚æ•°:"
        echo "$duplicates"
        ((error_count++))
    fi
    
#    # æ€»ç»“
    if [ $error_count -eq 0 ]; then
        echo "âœ“ è¯­æ³•æ£€æŸ¥é€šè¿‡ï¼Œæœªå‘ç°é”™è¯¯"
    else
        echo "âœ— å‘ç° $error_count ä¸ªè¯­æ³•é—®é¢˜ï¼Œè¯·ä¿®å¤åé‡è¯•"
    fi
    
    return $error_count
}
```

### 13.3 é€»è¾‘éªŒè¯æ–¹æ³•



**ğŸ§® å‚æ•°å€¼åˆç†æ€§æ£€æŸ¥**
```bash
# å‚æ•°èŒƒå›´å’Œé€»è¾‘éªŒè¯è„šæœ¬

validate_parameter_logic() {
    echo "=== å‚æ•°é€»è¾‘éªŒè¯ ==="
    
#    # è·å–ç³»ç»Ÿä¿¡æ¯
    local total_memory_gb=$(free -g | grep '^Mem:' | awk '{print $2}')
    local cpu_cores=$(nproc)
    
    echo "ç³»ç»Ÿä¿¡æ¯: ${total_memory_gb}GBå†…å­˜, ${cpu_cores}ä¸ªCPUæ ¸å¿ƒ"
    
#    # éªŒè¯å†…å­˜ç›¸å…³å‚æ•°
    echo "éªŒè¯å†…å­˜å‚æ•°..."
    local buffer_pool_size=$(mysql -e "SELECT $$innodb_buffer_pool_size;" 2>/dev/null | tail -1)
    if [ -n "$buffer_pool_size" ] && [ "$buffer_pool_size" -gt 0 ]; then
        local buffer_pool_gb=$((buffer_pool_size / 1024 / 1024 / 1024))
        echo "InnoDBç¼“å†²æ± å¤§å°: ${buffer_pool_gb}GB"
        
        if [ "$buffer_pool_gb" -gt $((total_memory_gb * 8 / 10)) ]; then
            echo "âš ï¸  è­¦å‘Š: ç¼“å†²æ± å¤§å°è¿‡å¤§ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³"
        elif [ "$buffer_pool_gb" -lt $((total_memory_gb / 4)) ]; then
            echo "ğŸ’¡ å»ºè®®: ç¼“å†²æ± å¤§å°åå°ï¼Œå¯ä»¥é€‚å½“å¢åŠ "
        else
            echo "âœ“ ç¼“å†²æ± å¤§å°åˆç†"
        fi
    fi
    
#    # éªŒè¯è¿æ¥æ•°å‚æ•°
    echo "éªŒè¯è¿æ¥æ•°å‚æ•°..."
    local max_conn=$(mysql -e "SELECT $$max_connections;" 2>/dev/null | tail -1)
    if [ -n "$max_conn" ] && [ "$max_conn" -gt 0 ]; then
        echo "æœ€å¤§è¿æ¥æ•°: $max_conn"
        
#        # æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
        local ulimit_n=$(ulimit -n)
        if [ "$max_conn" -gt $((ulimit_n / 2)) ]; then
            echo "âš ï¸  è­¦å‘Š: æœ€å¤§è¿æ¥æ•°å¯èƒ½è¶…å‡ºæ–‡ä»¶æè¿°ç¬¦é™åˆ¶"
            echo "   å½“å‰ulimit -n: $ulimit_n"
            echo "   å»ºè®®è°ƒæ•´ç³»ç»Ÿé™åˆ¶æˆ–å‡å°‘max_connections"
        else
            echo "âœ“ è¿æ¥æ•°è®¾ç½®åˆç†"
        fi
    fi
}

# å‚æ•°å†²çªæ£€æŸ¥

check_parameter_conflicts() {
    echo "=== å‚æ•°å†²çªæ£€æŸ¥ ==="
    
#    # æ£€æŸ¥å­˜å‚¨å¼•æ“ç›¸å…³å†²çª
    local default_engine=$(mysql -e "SELECT $$default_storage_engine;" 2>/dev/null | tail -1)
    local key_buffer=$(mysql -e "SELECT $$key_buffer_size;" 2>/dev/null | tail -1)
    local innodb_buffer=$(mysql -e "SELECT $$innodb_buffer_pool_size;" 2>/dev/null | tail -1)
    
    if [ "$default_engine" = "InnoDB" ]; then
        local key_buffer_mb=$((key_buffer / 1024 / 1024))
        local innodb_buffer_mb=$((innodb_buffer / 1024 / 1024))
        
        if [ "$key_buffer_mb" -gt "$innodb_buffer_mb" ]; then
            echo "âš ï¸  è­¦å‘Š: é»˜è®¤ä½¿ç”¨InnoDBä½†MyISAMé”®ç¼“å†²æ¯”InnoDBç¼“å†²æ± è¿˜å¤§"
            echo "   key_buffer_size: ${key_buffer_mb}MB"
            echo "   innodb_buffer_pool_size: ${innodb_buffer_mb}MB"
            echo "   å»ºè®®è°ƒæ•´å†…å­˜åˆ†é…æ¯”ä¾‹"
        fi
    fi
    
#    # æ£€æŸ¥æ—¥å¿—ç›¸å…³å†²çª
    local binlog_enabled=$(mysql -e "SELECT $$log_bin;" 2>/dev/null | tail -1)
    local sync_binlog=$(mysql -e "SELECT $$sync_binlog;" 2>/dev/null | tail -1)
    
    if [ "$binlog_enabled" = "ON" ] && [ "$sync_binlog" -eq 0 ]; then
        echo "âš ï¸  è­¦å‘Š: å¼€å¯äº†äºŒè¿›åˆ¶æ—¥å¿—ä½†sync_binlog=0"
        echo "   è¿™å¯èƒ½å¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜"
        echo "   å»ºè®®è®¾ç½®sync_binlog=1ä»¥ç¡®ä¿æ•°æ®å®‰å…¨"
    fi
}
```

### 13.4 åŠŸèƒ½éªŒè¯æ–¹æ³•



**ğŸ”§ é…ç½®ç”Ÿæ•ˆéªŒè¯**
```sql
-- åˆ›å»ºé…ç½®éªŒè¯æŸ¥è¯¢é›†åˆ
-- éªŒè¯å…³é”®å‚æ•°æ˜¯å¦ç”Ÿæ•ˆ
CREATE TEMPORARY TABLE config_verification AS
SELECT 
    'max_connections' AS parameter,
    $$max_connections AS current_value,
    'æ£€æŸ¥è¿æ¥æ•°é™åˆ¶' AS description
UNION ALL
SELECT 
    'innodb_buffer_pool_size',
    $$innodb_buffer_pool_size,
    'æ£€æŸ¥InnoDBç¼“å†²æ± å¤§å°'
UNION ALL
SELECT 
    'log_bin',
    $$log_bin,
    'æ£€æŸ¥äºŒè¿›åˆ¶æ—¥å¿—çŠ¶æ€'
UNION ALL
SELECT 
    'slow_query_log',
    $$slow_query_log,
    'æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—çŠ¶æ€';

-- æ˜¾ç¤ºéªŒè¯ç»“æœ
SELECT * FROM config_verification;

-- åŠŸèƒ½æ€§æµ‹è¯•
-- æµ‹è¯•è¿æ¥åŠŸèƒ½
SELECT 'Connection Test' AS test_name, 'PASS' AS result;

-- æµ‹è¯•åŸºæœ¬æŸ¥è¯¢åŠŸèƒ½
SELECT 'Basic Query Test' AS test_name, 
       CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS result
FROM information_schema.TABLES LIMIT 1;

-- æµ‹è¯•æƒé™åŠŸèƒ½
SELECT 'Permission Test' AS test_name,
       CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS result
FROM mysql.user WHERE User = 'root';
```

**ğŸ“Š æ€§èƒ½åŸºå‡†éªŒè¯**
```bash
# æ€§èƒ½éªŒè¯è„šæœ¬

performance_validation() {
    echo "=== æ€§èƒ½åŸºå‡†éªŒè¯ ==="
    
#    # ç®€å•æ€§èƒ½æµ‹è¯•
    echo "æ‰§è¡ŒåŸºå‡†æŸ¥è¯¢æµ‹è¯•..."
    
#    # æµ‹è¯•æŸ¥è¯¢æ€§èƒ½
    time mysql -e "
    SELECT COUNT(*) FROM information_schema.TABLES;
    SELECT COUNT(*) FROM information_schema.COLUMNS;
    SELECT $$version;
    " > /dev/null
    
#    # æµ‹è¯•è¿æ¥æ€§èƒ½
    echo "æµ‹è¯•è¿æ¥å»ºç«‹æ€§èƒ½..."
    start_time=$(date +%s.%N)
    for i in {1..10}; do
        mysql -e "SELECT 1;" > /dev/null 2>&1
    done
    end_time=$(date +%s.%N)
    
    connection_time=$(echo "$end_time - $start_time" | bc -l)
    avg_connection_time=$(echo "scale=3; $connection_time / 10" | bc -l)
    
    echo "å¹³å‡è¿æ¥æ—¶é—´: ${avg_connection_time}ç§’"
    
#    # æ£€æŸ¥å…³é”®æ€§èƒ½æŒ‡æ ‡
    echo "æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡..."
    mysql -e "
    SELECT 
        'QPS' AS metric,
        ROUND(Questions.value / Uptime.value, 2) AS value,
        'æŸ¥è¯¢/ç§’' AS unit
    FROM 
        (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Questions') Questions,
        (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Uptime') Uptime
    UNION ALL
    SELECT 
        'ç¼“å†²æ± å‘½ä¸­ç‡',
        ROUND((1 - Pool_reads.value / Pool_read_requests.value) * 100, 2),
        '%'
    FROM 
        (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Innodb_buffer_pool_reads') Pool_reads,
        (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Innodb_buffer_pool_read_requests') Pool_read_requests
    WHERE Pool_read_requests.value > 0;
    "
}
```

### 13.5 è‡ªåŠ¨åŒ–éªŒè¯æ¡†æ¶



**ğŸ¤– å®Œæ•´çš„é…ç½®éªŒè¯è„šæœ¬**
```bash
#!/bin/bash

# MySQLé…ç½®å®Œæ•´éªŒè¯è„šæœ¬


CONFIG_FILE="/etc/mysql/my.cnf"
LOG_FILE="/var/log/mysql/config_validation.log"
DATE=$(date '+%Y-%m-%d %H:%M:%S')

# åˆå§‹åŒ–æ—¥å¿—

echo "[$DATE] === MySQLé…ç½®éªŒè¯å¼€å§‹ ===" | tee -a $LOG_FILE

# éªŒè¯å‡½æ•°

validate_all() {
    local errors=0
    
#    # 1. è¯­æ³•éªŒè¯
    echo "1. è¯­æ³•éªŒè¯..." | tee -a $LOG_FILE
    if ! mysqld --help --verbose --defaults-file="$CONFIG_FILE" > /dev/null 2>&1; then
        echo "âœ— è¯­æ³•éªŒè¯å¤±è´¥" | tee -a $LOG_FILE
        mysqld --help --verbose --defaults-file="$CONFIG_FILE" 2>&1 | grep -i error | tee -a $LOG_FILE
        ((errors++))
    else
        echo "âœ“ è¯­æ³•éªŒè¯é€šè¿‡" | tee -a $LOG_FILE
    fi
    
#    # 2. æƒé™éªŒè¯
    echo "2. æƒé™éªŒè¯..." | tee -a $LOG_FILE
    if [ ! -r "$CONFIG_FILE" ]; then
        echo "âœ— é…ç½®æ–‡ä»¶ä¸å¯è¯»" | tee -a $LOG_FILE
        ((errors++))
    elif [ ! -f "$CONFIG_FILE" ]; then
        echo "âœ— é…ç½®æ–‡ä»¶ä¸å­˜åœ¨" | tee -a $LOG_FILE
        ((errors++))
    else
        echo "âœ“ æƒé™éªŒè¯é€šè¿‡" | tee -a $LOG_FILE
    fi
    
#    # 3. MySQLæœåŠ¡çŠ¶æ€éªŒè¯
    echo "3. æœåŠ¡çŠ¶æ€éªŒè¯..." | tee -a $LOG_FILE
    if ! systemctl is-active --quiet mysql; then
        echo "âœ— MySQLæœåŠ¡æœªè¿è¡Œ" | tee -a $LOG_FILE
        ((errors++))
    else
        echo "âœ“ MySQLæœåŠ¡è¿è¡Œæ­£å¸¸" | tee -a $LOG_FILE
    fi
    
#    # 4. è¿æ¥éªŒè¯
    echo "4. è¿æ¥éªŒè¯..." | tee -a $LOG_FILE
    if ! mysql -e "SELECT 1;" > /dev/null 2>&1; then
        echo "âœ— æ— æ³•è¿æ¥åˆ°MySQL" | tee -a $LOG_FILE
        ((errors++))
    else
        echo "âœ“ è¿æ¥éªŒè¯é€šè¿‡" | tee -a $LOG_FILE
    fi
    
#    # 5. å‚æ•°éªŒè¯
    echo "5. å‚æ•°éªŒè¯..." | tee -a $LOG_FILE
    validate_critical_parameters
    
#    # 6. æ€§èƒ½éªŒè¯
    echo "6. æ€§èƒ½éªŒè¯..." | tee -a $LOG_FILE
    validate_performance_indicators
    
#    # æ€»ç»“
    echo "[$DATE] === éªŒè¯å®Œæˆ ===" | tee -a $LOG_FILE
    if [ $errors -eq 0 ]; then
        echo "âœ“ æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Œé…ç½®æ­£å¸¸" | tee -a $LOG_FILE
        return 0
    else
        echo "âœ— å‘ç° $errors ä¸ªé—®é¢˜ï¼Œè¯·æ£€æŸ¥é…ç½®" | tee -a $LOG_FILE
        return 1
    fi
}

# å…³é”®å‚æ•°éªŒè¯

validate_critical_parameters() {
    local param_errors=0
    
#    # æ£€æŸ¥å†…å­˜å‚æ•°
    local total_mem_gb=$(free -g | grep '^Mem:' | awk '{print $2}')
    local buffer_pool_gb=$(mysql -e "SELECT $$innodb_buffer_pool_size/1024/1024/1024;" 2>/dev/null | tail -1)
    
    if [ -n "$buffer_pool_gb" ] && (( $(echo "$buffer_pool_gb > $total_mem_gb * 0.8" | bc -l) )); then
        echo "âš ï¸  ç¼“å†²æ± å¤§å°å¯èƒ½è¿‡å¤§: ${buffer_pool_gb}GB (ç³»ç»Ÿå†…å­˜: ${total_mem_gb}GB)" | tee -a $LOG_FILE
    fi
    
#    # æ£€æŸ¥è¿æ¥æ•°
    local max_conn=$(mysql -e "SELECT $$max_connections;" 2>/dev/null | tail -1)
    local ulimit_n=$(ulimit -n)
    
    if [ -n "$max_conn" ] && [ "$max_conn" -gt $((ulimit_n / 2)) ]; then
        echo "âš ï¸  æœ€å¤§è¿æ¥æ•°å¯èƒ½è¶…å‡ºç³»ç»Ÿé™åˆ¶: $max_conn (ulimit: $ulimit_n)" | tee -a $LOG_FILE
    fi
    
    return $param_errors
}

# æ€§èƒ½æŒ‡æ ‡éªŒè¯

validate_performance_indicators() {
    mysql -e "
    SELECT 
        'QPS' AS metric,
        ROUND(Questions.value / GREATEST(Uptime.value, 1), 2) AS value
    FROM 
        (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Questions') Questions,
        (SELECT VARIABLE_VALUE AS value FROM performance_schema.global_status WHERE VARIABLE_NAME='Uptime') Uptime;
    " | tee -a $LOG_FILE
}

# æ‰§è¡ŒéªŒè¯

validate_all
exit_code=$?

# å¦‚æœéªŒè¯å¤±è´¥ï¼Œå‘é€å‘Šè­¦ï¼ˆè¿™é‡Œå¯ä»¥æ·»åŠ é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥æ–¹å¼ï¼‰

if [ $exit_code -ne 0 ]; then
    echo "é…ç½®éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—: $LOG_FILE"
fi

exit $exit_code
```

**â° å®šæœŸéªŒè¯è®¡åˆ’**
```bash
# æ·»åŠ åˆ°crontabï¼Œæ¯å¤©éªŒè¯ä¸€æ¬¡é…ç½®

(crontab -l 2>/dev/null; echo "0 6 * * * /usr/local/bin/mysql_config_validation.sh") | crontab -

# é…ç½®å˜æ›´åçš„å³æ—¶éªŒè¯

post_config_change_validation() {
    echo "é…ç½®å˜æ›´åéªŒè¯..."
    
#    # ç­‰å¾…é…ç½®ç”Ÿæ•ˆ
    sleep 5
    
#    # è¿è¡Œå®Œæ•´éªŒè¯
    /usr/local/bin/mysql_config_validation.sh
    
    if [ $? -eq 0 ]; then
        echo "âœ“ é…ç½®å˜æ›´éªŒè¯é€šè¿‡"
#        # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é€šçŸ¥æˆåŠŸçš„é€»è¾‘
    else
        echo "âœ— é…ç½®å˜æ›´éªŒè¯å¤±è´¥ï¼Œå»ºè®®å›æ»š"
#        # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å‘Šè­¦é€»è¾‘
    fi
}
```

---

## 14. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 14.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ é…ç½®å‚æ•°æ•…éšœæœ¬è´¨ï¼šé…ç½®æ–‡ä»¶é”™è¯¯ã€å‚æ•°å†²çªã€æƒé™é—®é¢˜å¯¼è‡´MySQLå¼‚å¸¸
ğŸ”¸ æ•…éšœæ’æŸ¥æ€è·¯ï¼šç°è±¡åˆ†æ â†’ é—®é¢˜å®šä½ â†’ è§£å†³æ–¹æ¡ˆ â†’ æ•ˆæœéªŒè¯
ğŸ”¸ é¢„é˜²èƒœäºæ²»ç–—ï¼šå¤‡ä»½ã€ç›‘æ§ã€éªŒè¯ã€æ–‡æ¡£åŒ–çš„é‡è¦æ€§
ğŸ”¸ æ¸è¿›å¼ä¼˜åŒ–ï¼šå°æ­¥å¿«è·‘ï¼Œé€æ­¥è°ƒæ•´ï¼Œé¿å…å¤§å¹…å˜æ›´å¸¦æ¥çš„é£é™©
ğŸ”¸ å½±å“è¯„ä¼°æœºåˆ¶ï¼šæ¯æ¬¡å˜æ›´éƒ½è¦è¯„ä¼°å¯¹æ€§èƒ½ã€ç¨³å®šæ€§ã€èµ„æºçš„å½±å“
```

### 14.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ é…ç½®æ•…éšœçš„æ ¹æœ¬åŸå› **
```
è¯­æ³•å±‚é¢ï¼š
- é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼ˆç¼ºå°‘æ‹¬å·ã€é”™è¯¯åˆ†éš”ç¬¦ï¼‰
- å‚æ•°åæ‹¼å†™é”™è¯¯ï¼ˆä¸‹åˆ’çº¿vsç©ºæ ¼ï¼‰
- æ³¨é‡Šæ ¼å¼ä¸æ­£ç¡®

é€»è¾‘å±‚é¢ï¼š
- å‚æ•°å€¼è¶…å‡ºåˆç†èŒƒå›´
- å‚æ•°é—´ç›¸äº’å†²çª
- èµ„æºåˆ†é…ä¸åˆç†

ç³»ç»Ÿå±‚é¢ï¼š
- æ–‡ä»¶æƒé™è®¾ç½®é”™è¯¯
- ç³»ç»Ÿèµ„æºé™åˆ¶
- ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
```

**ğŸ”¹ æ•…éšœæ’æŸ¥çš„ç³»ç»Ÿæ–¹æ³•**
```
è§‚å¯Ÿç°è±¡ï¼š
- MySQLæ— æ³•å¯åŠ¨ â†’ æ£€æŸ¥é”™è¯¯æ—¥å¿—
- æ€§èƒ½å¼‚å¸¸ â†’ æ£€æŸ¥å‚æ•°è®¾ç½®
- åŠŸèƒ½å¤±æ•ˆ â†’ æ£€æŸ¥é…ç½®ç”Ÿæ•ˆ

å®šä½é—®é¢˜ï¼š
- è¯­æ³•æ£€æŸ¥ â†’ mysqld --help --verbose
- æƒé™æ£€æŸ¥ â†’ ls -la å’Œæ–‡ä»¶è®¿é—®æµ‹è¯•
- å†²çªæ£€æŸ¥ â†’ å‚æ•°é€»è¾‘åˆ†æ

è§£å†³é—®é¢˜ï¼š
- å¤‡ä»½å½“å‰é…ç½®
- é€æ­¥ä¿®å¤é—®é¢˜
- éªŒè¯ä¿®å¤æ•ˆæœ
- æ–‡æ¡£åŒ–å˜æ›´è¿‡ç¨‹
```

**ğŸ”¹ å‚æ•°ä¼˜åŒ–çš„å¹³è¡¡è‰ºæœ¯**
```
æ€§èƒ½vsç¨³å®šæ€§ï¼š
- æå‡æ€§èƒ½çš„å‚æ•°å¯èƒ½å¢åŠ ç³»ç»Ÿé£é™©
- éœ€è¦åœ¨æ€§èƒ½æ”¶ç›Šå’Œç¨³å®šæ€§ä¹‹é—´æ‰¾å¹³è¡¡

èµ„æºvsæ•ˆæœï¼š
- æŠ•å…¥æ›´å¤šèµ„æºä¸ä¸€å®šå¸¦æ¥æˆæ¯”ä¾‹çš„æ•ˆæœ
- è¦åŸºäºå®é™…ç›‘æ§æ•°æ®åšå†³ç­–

å½“å‰vsé•¿è¿œï¼š
- è§£å†³å½“å‰é—®é¢˜vsè€ƒè™‘æœªæ¥æ‰©å±•
- çŸ­æœŸä¼˜åŒ–vsé•¿æœŸæ¶æ„åˆç†æ€§
```

### 14.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ’¼ ç”Ÿäº§ç¯å¢ƒå®è·µ**
```
æ—¥å¸¸è¿ç»´ï¼š
- å»ºç«‹é…ç½®å˜æ›´æµç¨‹å’Œå®¡æ‰¹æœºåˆ¶
- å®šæœŸéªŒè¯é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§
- ç›‘æ§å…³é”®å‚æ•°çš„å˜åŒ–è¶‹åŠ¿

æ•…éšœå¤„ç†ï¼š
- å¿«é€Ÿå®šä½é…ç½®ç›¸å…³æ•…éšœ
- æœ‰åºå›æ»šé—®é¢˜é…ç½®
- æ€»ç»“æ•…éšœç»éªŒï¼Œå®Œå–„é¢„é˜²æªæ–½

æ€§èƒ½ä¼˜åŒ–ï¼š
- åŸºäºä¸šåŠ¡éœ€æ±‚è°ƒæ•´å‚æ•°
- è¯„ä¼°ä¼˜åŒ–æ•ˆæœå’Œå‰¯ä½œç”¨
- å»ºç«‹æ€§èƒ½åŸºå‡†å’Œå¯¹æ¯”æœºåˆ¶
```

**ğŸ”§ æŠ€èƒ½æå‡è·¯å¾„**
```
åŸºç¡€æŠ€èƒ½ï¼š
- ç†Ÿç»ƒæŒæ¡MySQLé…ç½®æ–‡ä»¶è¯­æ³•
- ç†è§£å¸¸ç”¨å‚æ•°çš„å«ä¹‰å’Œå½±å“
- æŒæ¡åŸºæœ¬çš„æ•…éšœæ’æŸ¥æ–¹æ³•

è¿›é˜¶æŠ€èƒ½ï¼š
- èƒ½å¤Ÿè®¾è®¡å‚æ•°ä¼˜åŒ–æ–¹æ¡ˆ
- å»ºç«‹ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- å¤„ç†å¤æ‚çš„å‚æ•°å†²çªé—®é¢˜

ä¸“å®¶æŠ€èƒ½ï¼š
- é¢„æµ‹å‚æ•°å˜æ›´çš„ç³»ç»Ÿæ€§å½±å“
- è®¾è®¡è‡ªåŠ¨åŒ–é…ç½®ç®¡ç†æ–¹æ¡ˆ
- æŒ‡å¯¼å›¢é˜Ÿå»ºç«‹æœ€ä½³å®è·µ
```

### 14.4 æœ€ä½³å®è·µå»ºè®®



**ğŸ“ é…ç½®ç®¡ç†æœ€ä½³å®è·µ**
```
ç‰ˆæœ¬æ§åˆ¶ï¼š
- æ‰€æœ‰é…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶
- æ¯æ¬¡å˜æ›´éƒ½è¦æœ‰æ˜ç¡®çš„æäº¤ä¿¡æ¯
- å»ºç«‹é…ç½®å®¡æŸ¥å’Œæ‰¹å‡†æµç¨‹

å˜æ›´ç®¡ç†ï¼š
- åˆ¶å®šé…ç½®å˜æ›´æ ‡å‡†æµç¨‹
- è¦æ±‚å˜æ›´å‰åçš„éªŒè¯æ­¥éª¤
- å»ºç«‹å¿«é€Ÿå›æ»šæœºåˆ¶

ç›‘æ§å‘Šè­¦ï¼š
- ç›‘æ§å…³é”®é…ç½®å‚æ•°çš„å˜åŒ–
- è®¾ç½®é…ç½®å¼‚å¸¸çš„å‘Šè­¦æœºåˆ¶
- å®šæœŸæ£€æŸ¥é…ç½®æ–‡ä»¶çš„ä¸€è‡´æ€§

æ–‡æ¡£åŒ–ï¼š
- è®°å½•æ¯æ¬¡é…ç½®å˜æ›´çš„åŸå› å’Œå½±å“
- ç»´æŠ¤é…ç½®å‚æ•°çš„è¯´æ˜æ–‡æ¡£
- å»ºç«‹æ•…éšœå¤„ç†çŸ¥è¯†åº“
```

**âš ï¸ å¸¸è§é™·é˜±å’Œé¿å…æ–¹æ³•**
```
é™·é˜±1ï¼šç›²ç›®å¤åˆ¶ç½‘ä¸Šçš„é…ç½®
é¿å…ï¼šç†è§£æ¯ä¸ªå‚æ•°çš„å«ä¹‰å†ä½¿ç”¨

é™·é˜±2ï¼šä¸€æ¬¡æ€§ä¿®æ”¹å¤šä¸ªå‚æ•°
é¿å…ï¼šæ¯æ¬¡åªæ”¹ä¸€ä¸ªå‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœ

é™·é˜±3ï¼šå¿½è§†ç³»ç»Ÿèµ„æºé™åˆ¶
é¿å…ï¼šå……åˆ†äº†è§£ç³»ç»Ÿç¯å¢ƒå†è°ƒæ•´å‚æ•°

é™·é˜±4ï¼šä¸åšå¤‡ä»½å°±ä¿®æ”¹é…ç½®
é¿å…ï¼šä»»ä½•ä¿®æ”¹å‰éƒ½è¦å¤‡ä»½

é™·é˜±5ï¼šä¸éªŒè¯å°±åº”ç”¨åˆ°ç”Ÿäº§
é¿å…ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯åå†ä¸Šçº¿
```

**ğŸ¯ æŒç»­æ”¹è¿›å»ºè®®**
```
å®šæœŸè¯„ä¼°ï¼š
- æ¯å­£åº¦æ£€æŸ¥é…ç½®çš„åˆç†æ€§
- æ ¹æ®ä¸šåŠ¡å‘å±•è°ƒæ•´å‚æ•°è®¾ç½®
- æ¸…ç†ä¸å†éœ€è¦çš„é…ç½®é¡¹

å·¥å…·å»ºè®¾ï¼š
- å¼€å‘é…ç½®æ£€æŸ¥å·¥å…·
- å»ºç«‹è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹
- å®Œå–„ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

å›¢é˜Ÿå»ºè®¾ï¼š
- åŸ¹è®­å›¢é˜Ÿæˆå‘˜é…ç½®ç®¡ç†æŠ€èƒ½
- å»ºç«‹é…ç½®å˜æ›´çš„æ ‡å‡†æ“ä½œç¨‹åº
- åˆ†äº«æ•…éšœå¤„ç†ç»éªŒå’Œæ•™è®­
```

### 14.5 æ ¸å¿ƒè®°å¿†è¦ç‚¹



**ğŸ§  å…³é”®å£è¯€**
```
é…ç½®æ•…éšœæ’æŸ¥ä¸‰æ­¥èµ°ï¼š
çœ‹æ—¥å¿—ã€æŸ¥è¯­æ³•ã€éªŒæƒé™

å‚æ•°ä¼˜åŒ–äº”åŸåˆ™ï¼š
å¤‡ä»½å…ˆè¡Œã€æ¸è¿›è°ƒæ•´ã€ç›‘æ§è·Ÿè¸ªã€å½±å“è¯„ä¼°ã€å¿«é€Ÿå›æ»š

æ•…éšœé¢„é˜²å››è¦ç´ ï¼š
ç‰ˆæœ¬æ§åˆ¶ã€å®šæœŸéªŒè¯ã€æƒé™ç®¡ç†ã€æ–‡æ¡£æ›´æ–°

ç´§æ€¥å¤„ç†ä¸‰æ³•å®ï¼š
æœ€å°é…ç½®ã€å®‰å…¨æ¨¡å¼ã€å¿«é€Ÿæ¢å¤
```

**ğŸ“š æ·±åº¦å­¦ä¹ æ–¹å‘**
```
æŠ€æœ¯æ·±åŒ–ï¼š
- MySQLå†…æ ¸å‚æ•°è°ƒä¼˜åŸç†
- é«˜å¯ç”¨æ¶æ„çš„é…ç½®ç®¡ç†
- å®¹å™¨åŒ–ç¯å¢ƒçš„é…ç½®æœ€ä½³å®è·µ

å·¥å…·æŒæ¡ï¼š
- é…ç½®ç®¡ç†å·¥å…·ï¼ˆAnsibleã€Puppetï¼‰
- ç›‘æ§å·¥å…·ï¼ˆPrometheusã€Zabbixï¼‰
- è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼ˆKubernetesã€Dockerï¼‰

è¡Œä¸šå®è·µï¼š
- å¤§å‹äº’è”ç½‘å…¬å¸çš„é…ç½®ç®¡ç†å®è·µ
- äº‘ç¯å¢ƒä¸‹çš„MySQLé…ç½®ä¼˜åŒ–
- DevOpsæ–‡åŒ–ä¸­çš„é…ç½®å³ä»£ç ç†å¿µ
```

**æ ¸å¿ƒè®°å¿†æ€»ç»“**ï¼š
- MySQLé…ç½®æ•…éšœè™½ç„¶å¸¸è§ï¼Œä½†éƒ½æœ‰è§„å¾‹å¯å¾ª
- ç³»ç»Ÿæ€§çš„æ’æŸ¥æ–¹æ³•æ¯”ç»éªŒæ›´é‡è¦
- é¢„é˜²æªæ–½çš„ä»·å€¼è¿œå¤§äºäº‹åè¡¥æ•‘
- é…ç½®ç®¡ç†æ˜¯ä¸€é¡¹éœ€è¦æŒç»­æ”¹è¿›çš„ç³»ç»Ÿå·¥ç¨‹
- ç†è§£åŸç†æ¯”è®°ä½å‘½ä»¤æ›´é‡è¦ï¼ŒçŸ¥å…¶ç„¶æ›´è¦çŸ¥å…¶æ‰€ä»¥ç„¶

**æœ€ç»ˆæé†’**ï¼š
> ğŸ’¡ **é…ç½®å‚æ•°æ•…éšœæ’æŸ¥æ ¸å¿ƒæ€ç»´**
> 
> é‡åˆ°é—®é¢˜æ—¶ï¼Œä¸è¦æ…Œå¼ ï¼ŒæŒ‰ç…§"è§‚å¯Ÿç°è±¡ â†’ åˆ†æåŸå›  â†’ åˆ¶å®šæ–¹æ¡ˆ â†’ éªŒè¯æ•ˆæœ"çš„æ­¥éª¤ç³»ç»Ÿå¤„ç†ã€‚æ¯ä¸€æ­¥éƒ½è¦æœ‰æ®å¯ä¾ï¼Œæ¯ä¸€æ¬¡å˜æ›´éƒ½è¦å¯è¿½æº¯ã€å¯å›æ»šã€‚è®°ä½ï¼š**ç¨³å®šæ¯”å¿«é€Ÿæ›´é‡è¦ï¼Œç†è§£æ¯”èƒŒè¯µæ›´æœ‰æ•ˆ**ã€‚