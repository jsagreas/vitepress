---
title: 10ã€å­—ç¬¦é›†ç¼–ç æ•…éšœ
---
## ğŸ“š ç›®å½•

1. [å­—ç¬¦é›†åŸºç¡€æ¦‚å¿µ](#1-å­—ç¬¦é›†åŸºç¡€æ¦‚å¿µ)
2. [å­—ç¬¦é›†ä¸åŒ¹é…é”™è¯¯](#2-å­—ç¬¦é›†ä¸åŒ¹é…é”™è¯¯)
3. [æ•°æ®ä¹±ç é—®é¢˜è¯Šæ–­](#3-æ•°æ®ä¹±ç é—®é¢˜è¯Šæ–­)
4. [è¿æ¥å­—ç¬¦é›†è®¾ç½®](#4-è¿æ¥å­—ç¬¦é›†è®¾ç½®)
5. [UTF8ä¸UTF8MB4é—®é¢˜](#5-UTF8ä¸UTF8MB4é—®é¢˜)
6. [å­—ç¬¦é›†è½¬æ¢ä¸ä¿®å¤](#6-å­—ç¬¦é›†è½¬æ¢ä¸ä¿®å¤)
7. [å¤šè¯­è¨€ç¯å¢ƒå¤„ç†](#7-å¤šè¯­è¨€ç¯å¢ƒå¤„ç†)
8. [æ•…éšœæ’é™¤å®æˆ˜](#8-æ•…éšœæ’é™¤å®æˆ˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å­—ç¬¦é›†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å­—ç¬¦é›†


**ğŸ”¸ å­—ç¬¦é›†çš„æœ¬è´¨**
å­—ç¬¦é›†å°±åƒæ˜¯ä¸€æœ¬"ç¿»è¯‘å­—å…¸"ï¼Œå®ƒå‘Šè¯‰è®¡ç®—æœºå¦‚ä½•å°†æ–‡å­—è½¬æ¢æˆæ•°å­—ï¼Œä»¥åŠå¦‚ä½•å°†æ•°å­—è¿˜åŸæˆæ–‡å­—ã€‚

```
ç®€å•ç†è§£ï¼š
æ–‡å­— "ä½ å¥½" â†’ å­—ç¬¦é›†ç¼–ç  â†’ æ•°å­—å­˜å‚¨ â†’ å­—ç¬¦é›†è§£ç  â†’ æ˜¾ç¤º "ä½ å¥½"

å¦‚æœç¼–ç å’Œè§£ç ç”¨çš„ä¸æ˜¯åŒä¸€æœ¬"å­—å…¸"ï¼Œå°±ä¼šå‡ºç°ä¹±ç ï¼
```

**ğŸ”¸ MySQLä¸­çš„å­—ç¬¦é›†å±‚çº§**
```
æœåŠ¡å™¨çº§åˆ« (server)
    â†“
æ•°æ®åº“çº§åˆ« (database)  
    â†“
è¡¨çº§åˆ« (table)
    â†“
å­—æ®µçº§åˆ« (column)
    â†“
è¿æ¥çº§åˆ« (connection)
```

> ğŸ’¡ **é‡è¦ç†è§£**ï¼šMySQLçš„å­—ç¬¦é›†æ˜¯**å±‚å±‚ç»§æ‰¿**çš„ï¼Œå­çº§åˆ«ä¼šç»§æ‰¿çˆ¶çº§åˆ«çš„è®¾ç½®ï¼Œé™¤éæ˜ç¡®æŒ‡å®šã€‚

### 1.2 å¸¸è§å­—ç¬¦é›†å¯¹æ¯”


| å­—ç¬¦é›† | **å­˜å‚¨é•¿åº¦** | **æ”¯æŒè¯­è¨€** | **ä½¿ç”¨åœºæ™¯** | **MySQLç‰ˆæœ¬** |
|--------|-------------|-------------|-------------|--------------|
| `latin1` | 1å­—èŠ‚/å­—ç¬¦ | è¥¿æ¬§è¯­è¨€ | è‹±æ–‡ç³»ç»Ÿ(å·²è¿‡æ—¶) | æ‰€æœ‰ç‰ˆæœ¬ |
| `utf8` | 1-3å­—èŠ‚/å­—ç¬¦ | å¤§éƒ¨åˆ†è¯­è¨€ | **å±é™©**ï¼šä¸æ”¯æŒemoji | æ‰€æœ‰ç‰ˆæœ¬ |
| `utf8mb4` | 1-4å­—èŠ‚/å­—ç¬¦ | æ‰€æœ‰è¯­è¨€+emoji | **æ¨èä½¿ç”¨** | 5.5.3+ |
| `gbk` | 1-2å­—èŠ‚/å­—ç¬¦ | ä¸­æ–‡ | è€ç³»ç»Ÿå…¼å®¹ | æ‰€æœ‰ç‰ˆæœ¬ |

> âš ï¸ **é‡è¦æé†’**ï¼šå¾ˆå¤šäººä»¥ä¸º`utf8`æ˜¯ä¸‡èƒ½çš„ï¼Œä½†MySQLçš„`utf8`åªæ”¯æŒ3å­—èŠ‚ï¼Œå­˜å‚¨emojiä¼šæŠ¥é”™ï¼

---

## 2. âŒ å­—ç¬¦é›†ä¸åŒ¹é…é”™è¯¯


### 2.1 å…¸å‹é”™è¯¯ç°è±¡


**ğŸ”¸ å¸¸è§æŠ¥é”™ä¿¡æ¯**
```sql
-- é”™è¯¯1ï¼šå­—ç¬¦é›†ä¸åŒ¹é…
ERROR 1267 (HY000): Illegal mix of collations 
(utf8_general_ci,IMPLICIT) and (utf8mb4_general_ci,IMPLICIT) for operation '='

-- é”™è¯¯2ï¼šå­—ç¬¦æ— æ³•è½¬æ¢  
ERROR 1366 (HY000): Incorrect string value: '\xF0\x9F\x98\x80' for column 'content'

-- é”™è¯¯3ï¼šè¿æ¥å­—ç¬¦é›†é”™è¯¯
ERROR 1253 (42000): COLLATION 'utf8mb4_unicode_ci' is not valid for CHARACTER SET 'utf8'
```

### 2.2 é”™è¯¯äº§ç”ŸåŸå› 


**ğŸ”¸ åŸå› åˆ†æ**
```
åœºæ™¯1ï¼šè¡¨ç»“æ„ä¸ä¸€è‡´
ç”¨æˆ·è¡¨: utf8å­—ç¬¦é›†
è®¢å•è¡¨: utf8mb4å­—ç¬¦é›†
â†’ å…³è”æŸ¥è¯¢æ—¶å­—ç¬¦é›†å†²çª

åœºæ™¯2ï¼šåº”ç”¨ç¨‹åºè®¾ç½®é”™è¯¯
æ•°æ®åº“: utf8mb4
åº”ç”¨è¿æ¥: ä»ä½¿ç”¨utf8
â†’ æ•°æ®æ’å…¥æ—¶ç¼–ç è½¬æ¢å¤±è´¥

åœºæ™¯3ï¼šæ•°æ®è¿ç§»å­—ç¬¦é›†å˜æ›´
æ—§æ•°æ®: gbkç¼–ç 
æ–°ç¯å¢ƒ: utf8mb4
â†’ ä¸­æ–‡æ˜¾ç¤ºä¹±ç 
```

### 2.3 å¿«é€Ÿæ£€æŸ¥æ–¹æ³•


**ğŸ”§ è¯Šæ–­å‘½ä»¤**
```sql
-- æŸ¥çœ‹æœåŠ¡å™¨å­—ç¬¦é›†è®¾ç½®
SHOW VARIABLES LIKE 'character_set%';

-- æŸ¥çœ‹æ’åºè§„åˆ™è®¾ç½®  
SHOW VARIABLES LIKE 'collation%';

-- æŸ¥çœ‹å…·ä½“è¡¨çš„å­—ç¬¦é›†
SHOW CREATE TABLE your_table_name;

-- æŸ¥çœ‹æ‰€æœ‰è¡¨çš„å­—ç¬¦é›†ä¿¡æ¯
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME, 
    TABLE_COLLATION
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database';
```

**ğŸ” è¾“å‡ºè§£è¯»**
```
é‡è¦å˜é‡è¯´æ˜ï¼š
character_set_server     : æœåŠ¡å™¨é»˜è®¤å­—ç¬¦é›†
character_set_database   : å½“å‰æ•°æ®åº“å­—ç¬¦é›†  
character_set_connection : è¿æ¥å­—ç¬¦é›†
character_set_client     : å®¢æˆ·ç«¯å­—ç¬¦é›†
character_set_results    : ç»“æœé›†å­—ç¬¦é›†

æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™äº›åº”è¯¥ä¿æŒä¸€è‡´ï¼
```

---

## 3. ğŸ”§ æ•°æ®ä¹±ç é—®é¢˜è¯Šæ–­


### 3.1 ä¹±ç ç±»å‹è¯†åˆ«


**ğŸ”¸ å¸¸è§ä¹±ç æ¨¡å¼**
```
1. ä¸­æ–‡æ˜¾ç¤ºä¸ºé—®å· "???"
   â†’ å­—ç¬¦é›†ä¸æ”¯æŒä¸­æ–‡(å¦‚latin1)

2. ä¸­æ–‡æ˜¾ç¤ºä¸ºæ–¹å— "â–¡â–¡â–¡"
   â†’ å®¢æˆ·ç«¯å­—ä½“ä¸æ”¯æŒï¼Œä½†æ•°æ®æ­£å¸¸

3. ä¸­æ–‡æ˜¾ç¤ºä¸ºä¹±ç  "é´æˆ æ®‘"  
   â†’ ç¼–ç è§£ç å­—ç¬¦é›†ä¸åŒ¹é…

4. emojiæ˜¾ç¤ºä¸ºé—®å· "?"
   â†’ ä½¿ç”¨äº†utf8è€Œéutf8mb4
```

### 3.2 ä¹±ç è¯Šæ–­æµç¨‹


```
è¯Šæ–­æ­¥éª¤ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ£€æŸ¥å­˜å‚¨æ•°æ®  â”‚ â† ç”¨HEX()å‡½æ•°æŸ¥çœ‹åŸå§‹å­—èŠ‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. æ£€æŸ¥è¡¨å­—ç¬¦é›†  â”‚ â† SHOW CREATE TABLE  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. æ£€æŸ¥è¿æ¥è®¾ç½®  â”‚ â† SHOW VARIABLES LIKE 'char%'
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. æ£€æŸ¥å®¢æˆ·ç«¯    â”‚ â† åº”ç”¨ç¨‹åºç¼–ç è®¾ç½®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ” æ•°æ®æ£€æŸ¥å®ä¾‹**
```sql
-- æ£€æŸ¥å­˜å‚¨çš„åŸå§‹æ•°æ®
SELECT content, HEX(content) FROM test_table WHERE id = 1;

-- æ­£å¸¸UTF8MB4ä¸­æ–‡çš„åå…­è¿›åˆ¶åº”è¯¥æ˜¯è¿™æ ·ï¼š
-- 'ä½ å¥½' â†’ E4BDA0E5A5BD

-- å¦‚æœçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ï¼Œè¯´æ˜æ•°æ®å·²ç»æŸåï¼š
-- '???' â†’ 3F3F3F
```

### 3.3 æ•°æ®å®Œæ•´æ€§éªŒè¯


**ğŸ”¸ éªŒè¯æ–¹æ³•**
```sql
-- åˆ›å»ºæµ‹è¯•è¡¨éªŒè¯å­—ç¬¦é›†
CREATE TABLE charset_test (
    id INT AUTO_INCREMENT PRIMARY KEY,
    chinese_text VARCHAR(100),
    emoji_text VARCHAR(100)
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO charset_test (chinese_text, emoji_text) 
VALUES ('ä½ å¥½ä¸–ç•Œ', 'ğŸ˜€ğŸ˜ƒğŸ˜„');

-- æŸ¥çœ‹æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
SELECT * FROM charset_test;
```

---

## 4. ğŸ”— è¿æ¥å­—ç¬¦é›†è®¾ç½®


### 4.1 è¿æ¥å­—ç¬¦é›†çš„é‡è¦æ€§


**ğŸ”¸ è¿æ¥å­—ç¬¦é›†ä½œç”¨**
è¿æ¥å­—ç¬¦é›†å†³å®šäº†å®¢æˆ·ç«¯å’ŒMySQLæœåŠ¡å™¨ä¹‹é—´æ•°æ®ä¼ è¾“æ—¶çš„ç¼–ç æ–¹å¼ï¼Œå®ƒå½±å“ä¸‰ä¸ªå…³é”®ç¯èŠ‚ï¼š

```
å®¢æˆ·ç«¯ â†’ [character_set_client] â†’ MySQLæœåŠ¡å™¨
         [character_set_connection] (å¤„ç†)
MySQLæœåŠ¡å™¨ â†’ [character_set_results] â†’ å®¢æˆ·ç«¯
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒä¸¤ä¸ªäººå¯¹è¯ï¼Œå¿…é¡»è¯´åŒä¸€ç§è¯­è¨€æ‰èƒ½æ­£ç¡®ç†è§£ï¼Œå¦åˆ™å°±ä¼š"é¸¡åŒé¸­è®²"ã€‚

### 4.2 æ­£ç¡®è®¾ç½®è¿æ¥å­—ç¬¦é›†


**ğŸ”¸ æ–¹æ³•ä¸€ï¼šè¿æ¥æ—¶æŒ‡å®š**
```sql
-- è¿æ¥æ—¶è®¾ç½®å­—ç¬¦é›†(æ¨è)
mysql -u username -p --default-character-set=utf8mb4

-- æˆ–åœ¨è¿æ¥åç«‹å³è®¾ç½®
SET NAMES utf8mb4;
```

**ğŸ”¸ æ–¹æ³•äºŒï¼šä¿®æ”¹é…ç½®æ–‡ä»¶**
```ini
# /etc/mysql/my.cnf æˆ– ~/.my.cnf
[client]
default-character-set = utf8mb4

[mysql]  
default-character-set = utf8mb4

[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
```

**ğŸ”¸ æ–¹æ³•ä¸‰ï¼šåº”ç”¨ç¨‹åºè®¾ç½®**
```python
# Pythonç¤ºä¾‹
import pymysql
connection = pymysql.connect(
    host='localhost',
    user='username', 
    password='password',
    database='testdb',
    charset='utf8mb4'  # å…³é”®è®¾ç½®
)
```

```java
// Javaç¤ºä¾‹
String url = "jdbc:mysql://localhost:3306/testdb" +
             "?useUnicode=true" +
             "&characterEncoding=utf8mb4" +
             "&useSSL=false";
```

### 4.3 è¿æ¥å­—ç¬¦é›†é—®é¢˜æ’æŸ¥


**ğŸ”§ æ£€æŸ¥è¿æ¥çŠ¶æ€**
```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥çš„å­—ç¬¦é›†è®¾ç½®
SHOW SESSION VARIABLES LIKE 'character_set%';

-- æŸ¥çœ‹å…¨å±€å­—ç¬¦é›†è®¾ç½®
SHOW GLOBAL VARIABLES LIKE 'character_set%';

-- æ£€æŸ¥æ˜¯å¦æœ‰å­—ç¬¦é›†è½¬æ¢è­¦å‘Š
SHOW WARNINGS;
```

---

## 5. ğŸ†š UTF8ä¸UTF8MB4é—®é¢˜


### 5.1 UTF8 vs UTF8MB4 çš„å…³é”®åŒºåˆ«


**ğŸ”¸ æ ¸å¿ƒå·®å¼‚**
```
MySQLçš„utf8 (å®é™…æ˜¯utf8mb3)ï¼š
âœ… æ”¯æŒ: å¤§éƒ¨åˆ†å¸¸ç”¨å­—ç¬¦
âŒ ä¸æ”¯æŒ: emojiè¡¨æƒ…ç¬¦å· ğŸ˜€
âŒ ä¸æ”¯æŒ: ä¸€äº›ç½•è§æ±‰å­— ğ ®·
å­˜å‚¨: æœ€å¤š3å­—èŠ‚/å­—ç¬¦

MySQLçš„utf8mb4ï¼š
âœ… æ”¯æŒ: æ‰€æœ‰Unicodeå­—ç¬¦  
âœ… æ”¯æŒ: emojiè¡¨æƒ…ç¬¦å· ğŸ˜€
âœ… æ”¯æŒ: æ‰€æœ‰æ±‰å­—åŒ…æ‹¬ç”Ÿåƒ»å­—
å­˜å‚¨: æœ€å¤š4å­—èŠ‚/å­—ç¬¦
```

> âš ï¸ **é‡è¦è­¦å‘Š**ï¼šMySQLçš„`utf8`ä¸æ˜¯çœŸæ­£çš„UTF-8ï¼å®ƒåªæ˜¯UTF-8çš„é˜‰å‰²ç‰ˆæœ¬ã€‚

### 5.2 UTF8MB4è¿ç§»ç­–ç•¥


**ğŸ”¸ å®‰å…¨è¿ç§»æ­¥éª¤**

```sql
-- æ­¥éª¤1ï¼šå¤‡ä»½æ•°æ®(å¿…é¡»ï¼)
mysqldump -u username -p database_name > backup.sql

-- æ­¥éª¤2ï¼šä¿®æ”¹æ•°æ®åº“å­—ç¬¦é›†
ALTER DATABASE database_name 
CHARACTER SET = utf8mb4 
COLLATE = utf8mb4_unicode_ci;

-- æ­¥éª¤3ï¼šä¿®æ”¹è¡¨å­—ç¬¦é›†
ALTER TABLE table_name 
CONVERT TO CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- æ­¥éª¤4ï¼šä¿®æ”¹å…·ä½“å­—æ®µ(å¦‚æœéœ€è¦)
ALTER TABLE table_name 
MODIFY COLUMN column_name VARCHAR(255) 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

**ğŸ”¸ æ‰¹é‡è½¬æ¢è„šæœ¬**
```sql
-- ç”Ÿæˆæ‰¹é‡è½¬æ¢SQLè¯­å¥
SELECT CONCAT(
    'ALTER TABLE ', 
    TABLE_NAME, 
    ' CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;'
) AS alter_sql
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database_name'
AND TABLE_TYPE = 'BASE TABLE';
```

### 5.3 UTF8MB4æ€§èƒ½å½±å“


**ğŸ“Š æ€§èƒ½å¯¹æ¯”**
```
ç´¢å¼•é•¿åº¦é™åˆ¶ï¼š
utf8: æœ€å¤§ç´¢å¼•é•¿åº¦ = 767å­—èŠ‚ Ã· 3 = 255å­—ç¬¦
utf8mb4: æœ€å¤§ç´¢å¼•é•¿åº¦ = 767å­—èŠ‚ Ã· 4 = 191å­—ç¬¦

å­˜å‚¨ç©ºé—´å½±å“ï¼š
è‹±æ–‡æ•°æ®: æ— å½±å“ (éƒ½æ˜¯1å­—èŠ‚)
ä¸­æ–‡æ•°æ®: æ— å½±å“ (éƒ½æ˜¯3å­—èŠ‚)  
emojiæ•°æ®: utf8æ— æ³•å­˜å‚¨ï¼Œutf8mb4éœ€è¦4å­—èŠ‚
```

> ğŸ’¡ **å®é™…ç»éªŒ**ï¼šå¯¹äº99%çš„åº”ç”¨ï¼Œutf8mb4çš„æ€§èƒ½å½±å“å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚

---

## 6. ğŸ”„ å­—ç¬¦é›†è½¬æ¢ä¸ä¿®å¤


### 6.1 å­—ç¬¦é›†è½¬æ¢åŸç†


**ğŸ”¸ è½¬æ¢è¿‡ç¨‹**
```
åŸå§‹æ•°æ® â†’ è§£ç (æ—§å­—ç¬¦é›†) â†’ Unicode â†’ ç¼–ç (æ–°å­—ç¬¦é›†) â†’ æ–°æ•°æ®

ä¾‹å¦‚ï¼šGBKè½¬UTF8MB4
"ä½ å¥½"(GBK) â†’ è§£ç  â†’ Unicodeç ç‚¹ â†’ UTF8MB4ç¼–ç  â†’ "ä½ å¥½"(UTF8MB4)
```

### 6.2 å®‰å…¨è½¬æ¢æ­¥éª¤


**ğŸ”¸ è½¬æ¢å‰å‡†å¤‡**
```sql
-- 1. åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
CREATE DATABASE test_charset_conversion 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- 2. å¤åˆ¶è¡¨ç»“æ„å’Œå°‘é‡æ•°æ®è¿›è¡Œæµ‹è¯•
CREATE TABLE test_table LIKE original_table;
INSERT INTO test_table SELECT * FROM original_table LIMIT 100;
```

**ğŸ”¸ æ•°æ®ä¿®å¤æ–¹æ¡ˆ**

```sql
-- æ–¹æ¡ˆ1ï¼šå¦‚æœæ•°æ®æœ¬èº«æ˜¯æ­£ç¡®çš„ï¼Œåªæ˜¯å­—ç¬¦é›†è®¾ç½®é”™è¯¯
ALTER TABLE table_name 
MODIFY COLUMN column_name VARCHAR(255) 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- æ–¹æ¡ˆ2ï¼šå¦‚æœæ•°æ®å·²ç»ä¹±ç ï¼Œéœ€è¦é‡æ–°å¯¼å…¥
-- 2.1 å¯¼å‡ºåŸå§‹æ•°æ®
mysqldump --default-character-set=latin1 -u username -p database_name > data.sql

-- 2.2 ä¿®æ”¹å¯¼å‡ºæ–‡ä»¶çš„å­—ç¬¦é›†å£°æ˜
sed -i 's/CHARSET=latin1/CHARSET=utf8mb4/g' data.sql

-- 2.3 é‡æ–°å¯¼å…¥
mysql --default-character-set=utf8mb4 -u username -p database_name < data.sql
```

### 6.3 å­—ç¬¦é›†ä¿®å¤å·¥å…·


**ğŸ› ï¸ è‡ªåŠ¨ä¿®å¤è„šæœ¬**
```sql
-- åˆ›å»ºä¿®å¤å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE FixCharset(IN db_name VARCHAR(64))
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE table_name VARCHAR(64);
    DECLARE cur CURSOR FOR 
        SELECT TABLE_NAME FROM information_schema.TABLES 
        WHERE TABLE_SCHEMA = db_name;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    OPEN cur;
    read_loop: LOOP
        FETCH cur INTO table_name;
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        SET @sql = CONCAT('ALTER TABLE ', table_name, 
                         ' CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci');
        PREPARE stmt FROM @sql;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
    END LOOP;
    CLOSE cur;
END$$
DELIMITER ;

-- ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹
CALL FixCharset('your_database_name');
```

---

## 7. ğŸŒ å¤šè¯­è¨€ç¯å¢ƒå¤„ç†


### 7.1 å¤šè¯­è¨€å­˜å‚¨ç­–ç•¥


**ğŸ”¸ ç»Ÿä¸€å­—ç¬¦é›†æ–¹æ¡ˆ**
```sql
-- æ¨èï¼šæ‰€æœ‰è¡¨éƒ½ä½¿ç”¨utf8mb4
CREATE TABLE multilang_content (
    id INT AUTO_INCREMENT PRIMARY KEY,
    language_code VARCHAR(10),  -- en, zh, ja, arç­‰
    title VARCHAR(255),
    content TEXT
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æ’å…¥å¤šè¯­è¨€æ•°æ®ç¤ºä¾‹
INSERT INTO multilang_content (language_code, title, content) VALUES
('zh', 'ä½ å¥½ä¸–ç•Œ', 'è¿™æ˜¯ä¸­æ–‡å†…å®¹ ğŸ˜€'),
('en', 'Hello World', 'This is English content ğŸ˜€'),  
('ja', 'ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ', 'ã“ã‚Œã¯æ—¥æœ¬èªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ ğŸ˜€'),
('ar', 'Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…', 'Ù‡Ø°Ø§ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ˜€');
```

### 7.2 æ’åºè§„åˆ™é€‰æ‹©


**ğŸ”¸ å¸¸ç”¨æ’åºè§„åˆ™å¯¹æ¯”**

| æ’åºè§„åˆ™ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **æ€§èƒ½** |
|---------|---------|-------------|---------|
| `utf8mb4_general_ci` | å¿«é€Ÿï¼Œä¸åŒºåˆ†å¤§å°å†™ | ä¸€èˆ¬åº”ç”¨ | æœ€å¿« |
| `utf8mb4_unicode_ci` | æ ‡å‡†Unicodeæ’åº | å¤šè¯­è¨€åº”ç”¨ | è¾ƒæ…¢ |
| `utf8mb4_bin` | åŒºåˆ†å¤§å°å†™ï¼ŒäºŒè¿›åˆ¶æ¯”è¾ƒ | åŒºåˆ†å¤§å°å†™åœºæ™¯ | æœ€å¿« |

```sql
-- é€‰æ‹©åˆé€‚çš„æ’åºè§„åˆ™
CREATE TABLE user_data (
    username VARCHAR(50) COLLATE utf8mb4_bin,      -- ç”¨æˆ·ååŒºåˆ†å¤§å°å†™
    display_name VARCHAR(100) COLLATE utf8mb4_unicode_ci,  -- æ˜¾ç¤ºåæ”¯æŒå¤šè¯­è¨€
    email VARCHAR(100) COLLATE utf8mb4_general_ci   -- é‚®ç®±ä¸åŒºåˆ†å¤§å°å†™
) CHARACTER SET utf8mb4;
```

### 7.3 å®¢æˆ·ç«¯å…¼å®¹æ€§å¤„ç†


**ğŸ”¸ å…¼å®¹æ€§æ£€æŸ¥**
```sql
-- æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒutf8mb4
SELECT 
    $$character_set_client AS client,
    $$character_set_connection AS connection,
    $$character_set_results AS results;

-- å¦‚æœå®¢æˆ·ç«¯ä¸æ”¯æŒï¼Œè®¾ç½®å…¼å®¹æ¨¡å¼
SET NAMES utf8mb4;
-- æˆ–é™çº§ä½¿ç”¨
SET NAMES utf8;
```

---

## 8. ğŸ”§ æ•…éšœæ’é™¤å®æˆ˜


### 8.1 emojiå­˜å‚¨å¤±è´¥


**ğŸš¨ é—®é¢˜ç°è±¡**
```sql
INSERT INTO posts (content) VALUES ('ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ ğŸ˜€');
-- ERROR 1366 (HY000): Incorrect string value: '\xF0\x9F\x98\x80' for column 'content'
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**
```sql
-- æ£€æŸ¥å½“å‰å­—ç¬¦é›†
SHOW CREATE TABLE posts;

-- ä¿®æ”¹è¡¨å­—ç¬¦é›†ä¸ºutf8mb4  
ALTER TABLE posts 
CONVERT TO CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- ç¡®ä¿è¿æ¥ä¹Ÿæ˜¯utf8mb4
SET NAMES utf8mb4;

-- é‡æ–°æ’å…¥æ•°æ®
INSERT INTO posts (content) VALUES ('ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ ğŸ˜€');
```

### 8.2 ä¸­æ–‡ä¹±ç é—®é¢˜


**ğŸš¨ é—®é¢˜ç°è±¡**
```
åŸå§‹æ•°æ®: "ä½ å¥½ä¸–ç•Œ"
æ˜¾ç¤ºç»“æœ: "Ã¤Â½ Ã¥Â¥Â½Ã¤Â¸Ã§Ã£"
```

**ğŸ”§ è¯Šæ–­æ­¥éª¤**
```sql
-- 1. æ£€æŸ¥åŸå§‹æ•°æ®
SELECT content, HEX(content) FROM posts WHERE id = 1;

-- 2. æ£€æŸ¥å­—ç¬¦é›†è®¾ç½®
SHOW VARIABLES LIKE 'character_set%';

-- 3. æµ‹è¯•æ’å…¥ä¸­æ–‡
INSERT INTO test_table (content) VALUES ('æµ‹è¯•ä¸­æ–‡');
SELECT * FROM test_table;
```

**ğŸ”§ ä¿®å¤æ–¹æ³•**
```sql
-- å¦‚æœæ•°æ®å­˜å‚¨æ­£ç¡®ä½†æ˜¾ç¤ºä¹±ç 
SET NAMES utf8mb4;

-- å¦‚æœæ•°æ®æœ¬èº«ä¹±ç ï¼Œéœ€è¦é‡æ–°å¯¼å…¥
-- 1. å¯¼å‡ºæ—¶æŒ‡å®šæ­£ç¡®å­—ç¬¦é›†
mysqldump --default-character-set=utf8mb4 -u username -p database > backup.sql

-- 2. æ¸…ç©ºè¡¨é‡æ–°å¯¼å…¥  
TRUNCATE TABLE your_table;
mysql --default-character-set=utf8mb4 -u username -p database < backup.sql
```

### 8.3 å­—ç¬¦é›†æ··åˆæŸ¥è¯¢é”™è¯¯


**ğŸš¨ é—®é¢˜ç°è±¡**
```sql
SELECT * FROM utf8_table t1 
JOIN utf8mb4_table t2 ON t1.name = t2.name;
-- ERROR 1267: Illegal mix of collations
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**
```sql
-- æ–¹æ¡ˆ1ï¼šåœ¨æŸ¥è¯¢ä¸­è½¬æ¢å­—ç¬¦é›†
SELECT * FROM utf8_table t1 
JOIN utf8mb4_table t2 ON 
CONVERT(t1.name USING utf8mb4) = t2.name;

-- æ–¹æ¡ˆ2ï¼šç»Ÿä¸€è¡¨å­—ç¬¦é›†(æ¨è)
ALTER TABLE utf8_table 
CONVERT TO CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

### 8.4 åº”ç”¨ç¨‹åºè¿æ¥é—®é¢˜


**ğŸš¨ é—®é¢˜ç°è±¡**
åº”ç”¨ç¨‹åºä¸­æ–‡æ­£å¸¸ï¼Œä½†æ•°æ®åº“ä¸­æ˜¾ç¤ºä¹±ç ã€‚

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**
```python
# Pythonç¤ºä¾‹ - æ­£ç¡®é…ç½®
import pymysql

# é”™è¯¯çš„è¿æ¥æ–¹å¼
connection = pymysql.connect(
    host='localhost',
    user='username',
    password='password', 
    database='testdb'
    # ç¼ºå°‘charsetè®¾ç½®
)

# æ­£ç¡®çš„è¿æ¥æ–¹å¼
connection = pymysql.connect(
    host='localhost',
    user='username',
    password='password',
    database='testdb',
    charset='utf8mb4',          # æŒ‡å®šå­—ç¬¦é›†
    use_unicode=True            # å¯ç”¨Unicodeæ”¯æŒ
)
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å­—ç¬¦é›†æœ¬è´¨ï¼šè®¡ç®—æœºå­˜å‚¨å’Œæ˜¾ç¤ºæ–‡å­—çš„"ç¿»è¯‘å­—å…¸"
ğŸ”¸ å±‚çº§ç»§æ‰¿ï¼šæœåŠ¡å™¨â†’æ•°æ®åº“â†’è¡¨â†’å­—æ®µâ†’è¿æ¥ï¼Œå­çº§ç»§æ‰¿çˆ¶çº§
ğŸ”¸ UTF8é™·é˜±ï¼šMySQLçš„utf8ä¸ç­‰äºçœŸæ­£çš„UTF-8ï¼Œè¦ç”¨utf8mb4
ğŸ”¸ è¿æ¥é‡è¦æ€§ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¿…é¡»ä½¿ç”¨ç›¸åŒå­—ç¬¦é›†
ğŸ”¸ ä¹±ç åŸå› ï¼šç¼–ç å’Œè§£ç ä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦é›†
```

### 9.2 å…³é”®æ“ä½œè¦ç‚¹


**ğŸ”¹ è¯Šæ–­å£è¯€**
```
çœ‹æŠ¥é”™ â†’ æŸ¥å­—ç¬¦é›† â†’ æ£€è¿æ¥ â†’ æµ‹æ•°æ® â†’ æ‰¾æ ¹å›  â†’ ä¿®å¤éªŒè¯

å…·ä½“æ­¥éª¤ï¼š
1. SHOW VARIABLES LIKE 'character_set%'  (æŸ¥çœ‹è®¾ç½®)
2. SHOW CREATE TABLE table_name          (æŸ¥çœ‹è¡¨ç»“æ„)  
3. SELECT HEX(column) FROM table         (æŸ¥çœ‹åŸå§‹æ•°æ®)
4. SET NAMES utf8mb4                     (ä¿®æ­£è¿æ¥)
5. ALTER TABLE ... CONVERT TO ...        (ä¿®å¤è¡¨ç»“æ„)
```

**ğŸ”¹ æœ€ä½³å®è·µ**
```
âœ… ç»Ÿä¸€ä½¿ç”¨utf8mb4å­—ç¬¦é›†
âœ… åº”ç”¨ç¨‹åºè¿æ¥æ—¶æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†  
âœ… æ–°é¡¹ç›®ä»ä¸€å¼€å§‹å°±ç”¨utf8mb4
âœ… æ•°æ®è¿ç§»å‰å¿…é¡»å¤‡ä»½
âœ… åˆ†é˜¶æ®µæµ‹è¯•ï¼Œä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰è¡¨
```

### 9.3 å¸¸è§é”™è¯¯é¢„é˜²


**ğŸ”¹ é¿å…è¸©å‘**
```
âŒ ä¸è¦ä½¿ç”¨MySQLçš„utf8ï¼Œç”¨utf8mb4
âŒ ä¸è¦å¿½ç•¥è¿æ¥å­—ç¬¦é›†è®¾ç½®
âŒ ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥ä¿®æ”¹å­—ç¬¦é›†
âŒ ä¸è¦å‡è®¾æ‰€æœ‰å®¢æˆ·ç«¯éƒ½æ”¯æŒutf8mb4
âŒ ä¸è¦å¿˜è®°ä¿®æ”¹åº”ç”¨ç¨‹åºé…ç½®
```

**ğŸ”¹ åº”æ€¥å¤„ç†**
```
ğŸ’¡ å‘ç°ä¹±ç ç«‹å³åœæ­¢å†™å…¥
ğŸ’¡ å…ˆå¤‡ä»½ï¼Œå†è¯Šæ–­ï¼Œåä¿®å¤
ğŸ’¡ åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ä¿®å¤æ–¹æ¡ˆ
ğŸ’¡ åˆ†æ‰¹æ¬¡å¤„ç†å¤§è¡¨ï¼Œé¿å…é”è¡¨
ğŸ’¡ å‡†å¤‡å›æ»šæ–¹æ¡ˆ
```

### 9.4 å®é™…åº”ç”¨ä»·å€¼


- **æ–°é¡¹ç›®è§„åˆ’**ï¼šä»è®¾è®¡é˜¶æ®µå°±è€ƒè™‘å­—ç¬¦é›†é€‰æ‹©
- **ç³»ç»Ÿè¿ç§»**ï¼šåˆ¶å®šè¯¦ç»†çš„å­—ç¬¦é›†å‡çº§è®¡åˆ’
- **æ•…éšœå¤„ç†**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³å­—ç¬¦é›†ç›¸å…³é—®é¢˜
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†é€‰æ‹©æ’åºè§„åˆ™ï¼Œå¹³è¡¡åŠŸèƒ½å’Œæ€§èƒ½
- **å›½é™…åŒ–æ”¯æŒ**ï¼šä¸ºå¤šè¯­è¨€åº”ç”¨æ‰“å¥½åŸºç¡€

**æ ¸å¿ƒè®°å¿†**ï¼š
- MySQLå­—ç¬¦é›†å±‚å±‚ç›¸æ‰£ï¼Œä¸€ç¯å‡ºé”™å…¨ç›˜çš†ä¹±
- utf8mb4æ˜¯ç‹é“ï¼Œutf8æ˜¯é™·é˜±è¦é¿å¼€
- è¿æ¥å­—ç¬¦é›†æ˜¯å…³é”®ï¼Œå®¢æˆ·ç«¯æœåŠ¡å™¨è¦ä¸€è‡´
- ä¹±ç é—®é¢˜æœ‰å¥—è·¯ï¼Œè¯Šæ–­ä¿®å¤æŒ‰æµç¨‹