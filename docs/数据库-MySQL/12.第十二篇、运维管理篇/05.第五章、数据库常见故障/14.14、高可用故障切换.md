---
title: 14ã€é«˜å¯ç”¨æ•…éšœåˆ‡æ¢
---
## ğŸ“š ç›®å½•

1. [é«˜å¯ç”¨æ•…éšœåˆ‡æ¢æ¦‚è¿°](#1-é«˜å¯ç”¨æ•…éšœåˆ‡æ¢æ¦‚è¿°)
2. [ä¸»ä»åˆ‡æ¢å¤±è´¥å¤„ç†](#2-ä¸»ä»åˆ‡æ¢å¤±è´¥å¤„ç†)
3. [VIPæ¼‚ç§»å¼‚å¸¸è§£å†³](#3-VIPæ¼‚ç§»å¼‚å¸¸è§£å†³)
4. [è„‘è£‚é—®é¢˜å¤„ç†](#4-è„‘è£‚é—®é¢˜å¤„ç†)
5. [è‡ªåŠ¨åˆ‡æ¢è¯¯è§¦å‘é˜²æŠ¤](#5-è‡ªåŠ¨åˆ‡æ¢è¯¯è§¦å‘é˜²æŠ¤)
6. [å¥åº·æ£€æŸ¥å¤±æ•ˆæ’æŸ¥](#6-å¥åº·æ£€æŸ¥å¤±æ•ˆæ’æŸ¥)
7. [æ•°æ®åŒæ­¥ä¸­æ–­æ¢å¤](#7-æ•°æ®åŒæ­¥ä¸­æ–­æ¢å¤)
8. [åˆ‡æ¢æ•°æ®ä¸¢å¤±é¢„é˜²](#8-åˆ‡æ¢æ•°æ®ä¸¢å¤±é¢„é˜²)
9. [æ•…éšœè½¬ç§»æµç¨‹ä¼˜åŒ–](#9-æ•…éšœè½¬ç§»æµç¨‹ä¼˜åŒ–)
10. [åˆ‡æ¢å›é€€å¤„ç†æœºåˆ¶](#10-åˆ‡æ¢å›é€€å¤„ç†æœºåˆ¶)
11. [å¤šå±‚æ•…éšœåˆ‡æ¢ç­–ç•¥](#11-å¤šå±‚æ•…éšœåˆ‡æ¢ç­–ç•¥)
12. [åˆ‡æ¢æ—¶é—´ä¼˜åŒ–æŠ€å·§](#12-åˆ‡æ¢æ—¶é—´ä¼˜åŒ–æŠ€å·§)
13. [åˆ‡æ¢å½±å“è¯„ä¼°æ–¹æ³•](#13-åˆ‡æ¢å½±å“è¯„ä¼°æ–¹æ³•)
14. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#14-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ é«˜å¯ç”¨æ•…éšœåˆ‡æ¢æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯é«˜å¯ç”¨æ•…éšœåˆ‡æ¢


> ğŸ’¡ **é€šä¿—è§£é‡Š**ï¼šå°±åƒå®¶é‡Œåœç”µæ—¶è‡ªåŠ¨å¯åŠ¨å¤‡ç”¨å‘ç”µæœºï¼Œå½“ä¸»æ•°æ®åº“å‡ºé—®é¢˜æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®åº“ç»§ç»­å·¥ä½œ

**æ•…éšœåˆ‡æ¢çš„æœ¬è´¨**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
åº”ç”¨ â”€â”€â†’ ä¸»åº“(Master) â”€â”€åŒæ­¥â”€â”€â†’ ä»åº“(Slave)

æ•…éšœåˆ‡æ¢ï¼š
åº”ç”¨ â”€â”€â†’ ä»åº“(æ–°Master) â”€â”€ç­‰å¾…â”€â”€â†’ åŸä¸»åº“(ä¿®å¤ä¸­)
```

### 1.2 åˆ‡æ¢è§¦å‘çš„å¸¸è§åœºæ™¯


**ç¡¬ä»¶æ•…éšœ**ï¼š
- ğŸ’¥ æœåŠ¡å™¨å®•æœºã€ç¡¬ç›˜æŸå
- ğŸ”Œ ç½‘ç»œä¸­æ–­ã€ç”µæºæ•…éšœ
- ğŸŒ¡ï¸ CPUè¿‡çƒ­ã€å†…å­˜é”™è¯¯

**è½¯ä»¶é—®é¢˜**ï¼š
- ğŸš« MySQLæœåŠ¡å´©æºƒ
- ğŸ“¦ æ“ä½œç³»ç»Ÿå¼‚å¸¸
- ğŸ”§ é…ç½®é”™è¯¯å¯¼è‡´æœåŠ¡ä¸å¯ç”¨

**æ€§èƒ½é—®é¢˜**ï¼š
- ğŸŒ å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼
- ğŸ”„ è¿æ¥æ•°è¾¾åˆ°ä¸Šé™
- ğŸ’¾ ç£ç›˜ç©ºé—´ä¸è¶³

### 1.3 åˆ‡æ¢è¿‡ç¨‹æ ¸å¿ƒæ­¥éª¤


```
æ•…éšœåˆ‡æ¢æµç¨‹å›¾ï¼š
    
æ•…éšœæ£€æµ‹ â†’ åœæ­¢ä¸»åº“å†™å…¥ â†’ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ â†’ æå‡ä»åº“ â†’ æ›´æ–°é…ç½® â†’ åº”ç”¨é‡è¿

   â†“           â†“             â†“           â†“        â†“        â†“
 å¥åº·æ£€æŸ¥    åœæ­¢åº”ç”¨       æ£€æŸ¥GTID     è®¾ç½®å¯å†™   VIPåˆ‡æ¢  ä¸šåŠ¡æ¢å¤
 å¤±è´¥è¶…æ—¶    å†™å…¥æ“ä½œ       ä½ç‚¹ä¸€è‡´     read_only  è·¯ç”±æ›´æ–°  æœåŠ¡æ­£å¸¸
```

---

## 2. âš ï¸ ä¸»ä»åˆ‡æ¢å¤±è´¥å¤„ç†


### 2.1 åˆ‡æ¢å¤±è´¥çš„å…¸å‹è¡¨ç°


**ç—‡çŠ¶è¯†åˆ«**ï¼š
```
ğŸ”´ é”™è¯¯ä¿¡å·ï¼š
â€¢ ä»åº“æå‡å¤±è´¥ï¼šERROR 1290 - read_only enabled
â€¢ åº”ç”¨è¿æ¥è¶…æ—¶ï¼šConnection timed out
â€¢ æ•°æ®ä¸ä¸€è‡´è­¦å‘Šï¼šGTID gap detected
â€¢ VIPç»‘å®šå¤±è´¥ï¼šCannot assign IP address
```

### 2.2 åˆ‡æ¢å¤±è´¥åŸå› åˆ†æ


**æ•°æ®åŒæ­¥æ»å**ï¼š
```bash
# æ£€æŸ¥ä¸»ä»å»¶è¿Ÿ
mysql> SHOW SLAVE STATUS\G
*************************** 1. row ***************************
             Slave_IO_State: Waiting for master to send event
              Seconds_Behind_Master: 3600  # å»¶è¿Ÿ1å°æ—¶ï¼
```

> âš ï¸ **å¸¸è§è¯¯åŒº**ï¼šå¾ˆå¤šäººè®¤ä¸ºä»åº“åªè¦åœ¨è¿è¡Œå°±èƒ½åˆ‡æ¢ï¼Œå®é™…ä¸Šæ•°æ®åŒæ­¥å»¶è¿Ÿå¯èƒ½å¯¼è‡´åˆ‡æ¢åæ•°æ®ä¸¢å¤±

**ç½‘ç»œåˆ†åŒºé—®é¢˜**ï¼š
```
ç½‘ç»œå¼‚å¸¸ç¤ºæ„ï¼š
    
åº”ç”¨å±‚ â”€â”€â”€â”€Ã—â”€â”€â”€â†’ ä¸»åº“ (ç½‘ç»œä¸é€š)
   â†“
åˆ‡æ¢ç¨‹åº â”€â”€â”€â”€âˆšâ”€â”€â”€â†’ ä»åº“ (ç½‘ç»œæ­£å¸¸)

ç»“æœï¼šåº”ç”¨ä»¥ä¸ºä¸»åº“æ•…éšœï¼Œä½†ä¸»åº“å®é™…æ­£å¸¸è¿è¡Œ
```

### 2.3 åˆ‡æ¢å¤±è´¥çš„è§£å†³æ–¹æ¡ˆ


**æ‰‹åŠ¨å¼ºåˆ¶åˆ‡æ¢**ï¼š
```sql
-- 1. åœ¨ä»åº“ä¸Šåœæ­¢åŒæ­¥
STOP SLAVE;

-- 2. è®¾ç½®ä»åº“ä¸ºå¯å†™
SET GLOBAL read_only = 0;
SET GLOBAL super_read_only = 0;

-- 3. é‡ç½®ä¸»åº“ä¿¡æ¯
RESET SLAVE ALL;
```

**ä¿®å¤æ•°æ®ä¸€è‡´æ€§**ï¼š
```bash
# ä½¿ç”¨pt-table-checksumæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
pt-table-checksum --host=master_ip --databases=mydb

# ä½¿ç”¨pt-table-syncä¿®å¤ä¸ä¸€è‡´æ•°æ®
pt-table-sync --execute --host=new_master_ip --databases=mydb
```

> ğŸ’¡ **å®æˆ˜æŠ€å·§**ï¼šåˆ‡æ¢å¤±è´¥æ—¶ä¸è¦æ€¥äºé‡è¯•ï¼Œå…ˆæ’æŸ¥æ ¹æœ¬åŸå› ï¼Œå¦åˆ™å¯èƒ½é€ æˆæ•°æ®æ··ä¹±

---

## 3. ğŸŒ VIPæ¼‚ç§»å¼‚å¸¸è§£å†³


### 3.1 ä»€ä¹ˆæ˜¯VIPæ¼‚ç§»


> ğŸ’­ **ç”Ÿæ´»ç±»æ¯”**ï¼šVIPå°±åƒé—¨ç‰Œå·ï¼Œå½“ä¸€å®¶åº—å…³é—¨æ—¶ï¼Œé—¨ç‰Œå·è¦è½¬ç§»åˆ°éš”å£çš„åˆ†åº—ï¼Œé¡¾å®¢æŒ‰åŸåœ°å€å°±èƒ½æ‰¾åˆ°æ–°åº—

**VIPå·¥ä½œåŸç†**ï¼š
```
æ­£å¸¸çŠ¶æ€ï¼š
ä¸»åº“æœåŠ¡å™¨ â”€â”€â”€â”€â†’ ç»‘å®šVIP: 192.168.1.100
ä»åº“æœåŠ¡å™¨ â”€â”€â”€â”€â†’ æ— VIPç»‘å®š

åˆ‡æ¢åï¼š
ä¸»åº“æœåŠ¡å™¨ â”€â”€â”€â”€â†’ æ— VIPç»‘å®š (æ•…éšœ)
ä»åº“æœåŠ¡å™¨ â”€â”€â”€â”€â†’ ç»‘å®šVIP: 192.168.1.100
```

### 3.2 VIPæ¼‚ç§»å¼‚å¸¸ç°è±¡


**å…¸å‹æ•…éšœè¡¨ç°**ï¼š
- ğŸ”„ VIPåœ¨ä¸¤å°æœåŠ¡å™¨é—´åå¤è·³è½¬
- âŒ VIPç»‘å®šå¤±è´¥ï¼Œåº”ç”¨æ— æ³•è¿æ¥
- ğŸ­ åŒVIPç°è±¡ï¼šä¸¤å°æœåŠ¡å™¨éƒ½ç»‘å®šäº†åŒä¸€IP

### 3.3 VIPå¼‚å¸¸æ’æŸ¥æ­¥éª¤


**æ£€æŸ¥VIPç»‘å®šçŠ¶æ€**ï¼š
```bash
# æŸ¥çœ‹å½“å‰IPç»‘å®š
ip addr show | grep "192.168.1.100"

# æ£€æŸ¥ARPè¡¨
arp -n | grep "192.168.1.100"

# æŸ¥çœ‹KeepalivedçŠ¶æ€
systemctl status keepalived
journalctl -u keepalived -f
```

**ç½‘ç»œè¿é€šæ€§æµ‹è¯•**ï¼š
```bash
# ä»åº”ç”¨æœåŠ¡å™¨æµ‹è¯•VIPè¿é€šæ€§
ping -c 3 192.168.1.100
telnet 192.168.1.100 3306

# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
iptables -L -n | grep 3306
```

### 3.4 VIPé—®é¢˜è§£å†³æ–¹æ¡ˆ


**Keepalivedé…ç½®ä¼˜åŒ–**ï¼š
```bash
# /etc/keepalived/keepalived.conf
vrrp_instance VI_1 {
    state BACKUP          # ä¸¤ç«¯éƒ½è®¾ä¸ºBACKUP
    interface eth0
    virtual_router_id 100
    priority 100          # ä¸»åº“ä¼˜å…ˆçº§é«˜ä¸€äº›
    advert_int 1
    nopreempt            # é˜²æ­¢æŠ¢å å¯¼è‡´é¢‘ç¹åˆ‡æ¢
    
    authentication {
        auth_type PASS
        auth_pass mysql_ha
    }
    
    virtual_ipaddress {
        192.168.1.100/24
    }
    
    # å¥åº·æ£€æŸ¥è„šæœ¬
    track_script {
        check_mysql
    }
}
```

> âš ï¸ **é‡è¦æé†’**ï¼šä¸è¦å°†ä¸¤ç«¯éƒ½è®¾ä¸ºMASTERçŠ¶æ€ï¼Œè¿™ä¼šå¯¼è‡´è„‘è£‚é—®é¢˜

---

## 4. ğŸ§  è„‘è£‚é—®é¢˜å¤„ç†


### 4.1 ä»€ä¹ˆæ˜¯è„‘è£‚ç°è±¡


> ğŸ¤” **å½¢è±¡æ¯”å–»**ï¼šå°±åƒä¸€ä¸ªå…¬å¸å‡ºç°äº†ä¸¤ä¸ªæ€»ç»ç†ï¼Œéƒ½è®¤ä¸ºè‡ªå·±æ˜¯è€æ¿ï¼Œç»“æœä¸‹å±ä¸çŸ¥é“å¬è°çš„

**è„‘è£‚çš„äº§ç”Ÿ**ï¼š
```
ç½‘ç»œåˆ†åŒºå‰ï¼š
åº”ç”¨ â”€â”€â†’ ä¸»åº“A (æ­£å¸¸) â†â”€â”€åŒæ­¥â”€â”€â†’ ä»åº“B (æ­£å¸¸)

ç½‘ç»œåˆ†åŒºåï¼š
åº”ç”¨åˆ†ç»„1 â”€â”€â†’ ä¸»åº“A (è®¤ä¸ºè‡ªå·±æ˜¯ä¸»)
åº”ç”¨åˆ†ç»„2 â”€â”€â†’ ä»åº“B (è¢«æå‡ä¸ºä¸») 

ç»“æœï¼šä¸¤ä¸ª"ä¸»åº“"åŒæ—¶æ¥å—å†™å…¥ï¼
```

### 4.2 è„‘è£‚çš„å±å®³


**æ•°æ®å†²çª**ï¼š
- ğŸ“Š åŒä¸€æ¡è®°å½•åœ¨ä¸¤ä¸ªåº“ä¸­è¢«ä¸åŒä¿®æ”¹
- ğŸ”„ ä¸»é”®å†²çªï¼šä¸¤è¾¹éƒ½æ’å…¥ç›¸åŒIDçš„è®°å½•
- ğŸ’¥ ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼šåº“å­˜æ‰£å‡åœ¨ä¸¤è¾¹åŒæ—¶å‘ç”Ÿ

### 4.3 è„‘è£‚æ£€æµ‹æ–¹æ³•


**ç›‘æ§æŒ‡æ ‡æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªä¸»åº“
SELECT $$read_only, $$super_read_only;

-- æŸ¥çœ‹GTIDæ‰§è¡Œæƒ…å†µ
SHOW MASTER STATUS;
SELECT $$gtid_executed;
```

**ç½‘ç»œæ£€æµ‹è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æ£€æµ‹æ˜¯å¦å‘ç”Ÿç½‘ç»œåˆ†åŒº
ping_result=$(ping -c 3 -W 2 ${OTHER_MYSQL_IP} | grep "packets transmitted")
if [[ $ping_result == *"0 received"* ]]; then
    echo "Network partition detected!"
    # è§¦å‘å‘Šè­¦
fi
```

### 4.4 è„‘è£‚é¢„é˜²æœºåˆ¶


**Quorumæœºåˆ¶**ï¼š
```
è®¾ç½®è§„åˆ™ï¼šåªæœ‰è·å¾—å¤šæ•°æ´¾æ”¯æŒæ‰èƒ½æˆä¸ºä¸»åº“

3èŠ‚ç‚¹é›†ç¾¤ï¼šéœ€è¦è‡³å°‘2ä¸ªèŠ‚ç‚¹åŒæ„
5èŠ‚ç‚¹é›†ç¾¤ï¼šéœ€è¦è‡³å°‘3ä¸ªèŠ‚ç‚¹åŒæ„

ç¤ºä¾‹ï¼š
èŠ‚ç‚¹1ã€èŠ‚ç‚¹2 â”€â”€â”€â”€ç½‘ç»œæ­£å¸¸â”€â”€â”€â”€â†’ å¯ä»¥é€‰ä¸»
èŠ‚ç‚¹3 â”€â”€â”€â”€ç½‘ç»œåˆ†åŒºâ”€â”€â”€â”€â†’ ä¸èƒ½ç‹¬ç«‹æˆä¸»
```

**FencingæŠ€æœ¯**ï¼š
```bash
# STONITH (Shoot The Other Node In The Head)
# å½“æ£€æµ‹åˆ°è„‘è£‚æ—¶ï¼Œä¸»åŠ¨å…³é—­å¯¹æ–¹èŠ‚ç‚¹

# ç¤ºä¾‹é…ç½®
fence_timeout = 30
fence_action = "poweroff"
```

---

## 5. ğŸš¨ è‡ªåŠ¨åˆ‡æ¢è¯¯è§¦å‘é˜²æŠ¤


### 5.1 è¯¯è§¦å‘çš„å¸¸è§åœºæ™¯


**ç½‘ç»œæŠ–åŠ¨**ï¼š
```
æ—¶é—´çº¿ï¼š
10:00:01 - ä¸»åº“å“åº”æ­£å¸¸
10:00:02 - ç½‘ç»œæŠ–åŠ¨ï¼Œç›‘æ§å¤±è”1ç§’
10:00:03 - è‡ªåŠ¨åˆ‡æ¢è¢«è§¦å‘ï¼
10:00:04 - ç½‘ç»œæ¢å¤ï¼Œä½†å·²ç»åˆ‡æ¢å®Œæˆ
```

**ç¬æ—¶æ€§èƒ½é—®é¢˜**ï¼š
- ğŸ”„ æ…¢æŸ¥è¯¢å¯¼è‡´è¿æ¥æ± è€—å°½
- ğŸ’¾ åƒåœ¾å›æ”¶å¯¼è‡´çŸ­æš‚åœé¡¿
- ğŸŒŠ çªå‘æµé‡é€ æˆä¸´æ—¶å“åº”æ…¢

### 5.2 é˜²è¯¯è§¦å‘ç­–ç•¥


**å¤šé‡æ£€æŸ¥æœºåˆ¶**ï¼š
```bash
# å¥åº·æ£€æŸ¥è„šæœ¬ç¤ºä¾‹
#!/bin/bash
mysql_check() {
    local fail_count=0
    local check_interval=2
    local max_fails=3
    
    for i in $(seq 1 $max_fails); do
        if ! mysql -h $MYSQL_HOST -e "SELECT 1" &>/dev/null; then
            ((fail_count++))
            echo "Check $i failed"
            sleep $check_interval
        else
            echo "MySQL is healthy"
            return 0
        fi
    done
    
    if [ $fail_count -eq $max_fails ]; then
        echo "MySQL failed $max_fails consecutive checks"
        return 1
    fi
}
```

**å»¶è¿Ÿè§¦å‘è®¾ç½®**ï¼š
```
ç›‘æ§é…ç½®ï¼š
è¿ç»­å¤±è´¥æ¬¡æ•°ï¼šâ‰¥ 3æ¬¡
æ£€æŸ¥é—´éš”ï¼š2ç§’
ç¡®è®¤å»¶è¿Ÿï¼š10ç§’

æ€»æ—¶é—´ï¼šè‡³å°‘16ç§’æ‰è§¦å‘åˆ‡æ¢
è¿™æ ·å¯ä»¥è¿‡æ»¤æ‰å¤§éƒ¨åˆ†ç¬æ—¶é—®é¢˜
```

### 5.3 åˆ‡æ¢æ¡ä»¶ä¼˜åŒ–


**å¤åˆå¥åº·æ£€æŸ¥**ï¼š
```sql
-- ä¸ä»…æ£€æŸ¥è¿æ¥ï¼Œè¿˜è¦æ£€æŸ¥åŠŸèƒ½
SELECT 
  $$read_only as readonly_status,
  COUNT(*) as connection_count 
FROM information_schema.PROCESSLIST;

-- æ£€æŸ¥å…³é”®ä¸šåŠ¡è¡¨
SELECT COUNT(*) FROM user_table LIMIT 1;
```

**ä¸šåŠ¡å±‚é¢éªŒè¯**ï¼š
```python
def advanced_health_check():
    checks = {
        'connection': check_mysql_connection(),
        'read_test': check_simple_select(),
        'write_test': check_simple_insert(),
        'replication': check_slave_status(),
        'disk_space': check_disk_usage()
    }
    
    # è‡³å°‘80%çš„æ£€æŸ¥é€šè¿‡æ‰è®¤ä¸ºå¥åº·
    passed = sum(1 for result in checks.values() if result)
    return passed >= len(checks) * 0.8
```

> ğŸ’¡ **ç»éªŒåˆ†äº«**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®è‡³å°‘30ç§’çš„æ•…éšœç¡®è®¤æ—¶é—´ï¼Œé¿å…å› ç½‘ç»œæŠ–åŠ¨é€ æˆä¸å¿…è¦çš„åˆ‡æ¢

---

## 6. ğŸ” å¥åº·æ£€æŸ¥å¤±æ•ˆæ’æŸ¥


### 6.1 å¥åº·æ£€æŸ¥å¤±æ•ˆç°è±¡


**å…¸å‹ç—‡çŠ¶**ï¼š
- âœ… MySQLæœåŠ¡æ­£å¸¸è¿è¡Œ
- âŒ å¥åº·æ£€æŸ¥æ˜¾ç¤ºå¤±è´¥
- ğŸ”„ åˆ‡æ¢ç¨‹åºé¢‘ç¹è§¦å‘
- ğŸ˜µ ä¸šåŠ¡å®é™…å¯æ­£å¸¸è®¿é—®

### 6.2 æ£€æŸ¥ç‚¹æ’æŸ¥æ¸…å•


**ç½‘ç»œå±‚æ£€æŸ¥**ï¼š
```bash
# 1. åŸºç¡€ç½‘ç»œè¿é€šæ€§
ping -c 3 mysql_server_ip

# 2. ç«¯å£å¯è¾¾æ€§
telnet mysql_server_ip 3306
nmap -p 3306 mysql_server_ip

# 3. é˜²ç«å¢™çŠ¶æ€
iptables -L -n | grep 3306
systemctl status firewalld
```

**åº”ç”¨å±‚æ£€æŸ¥**ï¼š
```bash
# 4. MySQLè¿›ç¨‹çŠ¶æ€
ps aux | grep mysql
systemctl status mysql

# 5. ç›‘å¬ç«¯å£ç¡®è®¤
netstat -tlnp | grep 3306
ss -tlnp | grep 3306

# 6. é”™è¯¯æ—¥å¿—æ£€æŸ¥
tail -100 /var/log/mysql/error.log
```

### 6.3 æƒé™é—®é¢˜æ’æŸ¥


**ç›‘æ§è´¦æˆ·æƒé™**ï¼š
```sql
-- æ£€æŸ¥ç›‘æ§ç”¨æˆ·æƒé™
SHOW GRANTS FOR 'monitor'@'%';

-- ç¡®ä¿æœ‰åŸºæœ¬æŸ¥è¯¢æƒé™
GRANT SELECT ON *.* TO 'monitor'@'%';
GRANT REPLICATION CLIENT ON *.* TO 'monitor'@'%';
FLUSH PRIVILEGES;
```

**è¿æ¥æ•°é™åˆ¶**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥æ•°
SHOW STATUS LIKE 'Threads_connected';
SHOW VARIABLES LIKE 'max_connections';

-- æŸ¥çœ‹è¿æ¥æ¥æº
SELECT 
  USER, 
  HOST, 
  COUNT(*) as connection_count 
FROM information_schema.PROCESSLIST 
GROUP BY USER, HOST;
```

### 6.4 ç›‘æ§è„šæœ¬ä¼˜åŒ–


**å¥å£®çš„æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æ”¹è¿›ç‰ˆå¥åº·æ£€æŸ¥è„šæœ¬

MYSQL_HOST="192.168.1.100"
MYSQL_USER="monitor"
MYSQL_PASS="password"
TIMEOUT=5

# å‡½æ•°ï¼šåŸºç¡€è¿æ¥æ£€æŸ¥
check_connection() {
    timeout $TIMEOUT mysql -h$MYSQL_HOST -u$MYSQL_USER -p$MYSQL_PASS \
        -e "SELECT 1" &>/dev/null
    return $?
}

# å‡½æ•°ï¼šä¸»ä»çŠ¶æ€æ£€æŸ¥
check_replication() {
    local result=$(timeout $TIMEOUT mysql -h$MYSQL_HOST -u$MYSQL_USER -p$MYSQL_PASS \
        -e "SHOW SLAVE STATUS\G" 2>/dev/null | grep "Slave_IO_Running")
    
    if [[ $result == *"Yes"* ]]; then
        return 0
    else
        return 1
    fi
}

# ä¸»æ£€æŸ¥å‡½æ•°
main_check() {
    if check_connection; then
        echo "Connection: OK"
        if check_replication; then
            echo "Replication: OK"
            return 0
        else
            echo "Replication: WARNING (but connection works)"
            return 0  # è¿æ¥æ­£å¸¸å°±ç®—å¥åº·
        fi
    else
        echo "Connection: FAILED"
        return 1
    fi
}

main_check
exit $?
```

---

## 7. ğŸ”„ æ•°æ®åŒæ­¥ä¸­æ–­æ¢å¤


### 7.1 åŒæ­¥ä¸­æ–­çš„è¡¨ç°


**ä¸­æ–­ä¿¡å·è¯†åˆ«**ï¼š
```sql
-- æŸ¥çœ‹åŒæ­¥çŠ¶æ€
mysql> SHOW SLAVE STATUS\G
*************************** 1. row ***************************
             Slave_IO_State: 
                Master_Host: 192.168.1.10
             Slave_IO_Running: No    â† å…³é”®æŒ‡æ ‡
            Slave_SQL_Running: Yes
              Seconds_Behind_Master: NULL
         Master_Log_File: mysql-bin.000100
     Read_Master_Log_Pos: 12345
          Relay_Log_File: relay-bin.000050
           Relay_Log_Pos: 67890
   Relay_Master_Log_File: mysql-bin.000100
        Slave_IO_Running: No         â† IOçº¿ç¨‹åœæ­¢
       Slave_SQL_Running: Yes        â† SQLçº¿ç¨‹æ­£å¸¸
             Last_Errno: 0
             Last_Error: 
           Last_IO_Errno: 2013       â† é”™è¯¯ä»£ç 
           Last_IO_Error: Lost connection to MySQL server during query
```

### 7.2 ä¸­æ–­åŸå› è¯Šæ–­


**ç½‘ç»œé—®é¢˜**ï¼š
```bash
# æ£€æŸ¥ä¸»ä»ä¹‹é—´ç½‘ç»œ
ping -c 5 master_ip
telnet master_ip 3306

# æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡
netstat -i
cat /proc/net/dev
```

**æƒé™è¿‡æœŸ**ï¼š
```sql
-- åœ¨ä¸»åº“æ£€æŸ¥å¤åˆ¶ç”¨æˆ·
SELECT User, Host, password_expired 
FROM mysql.user 
WHERE User = 'repl_user';

-- æ£€æŸ¥ç”¨æˆ·æƒé™
SHOW GRANTS FOR 'repl_user'@'slave_ip';
```

**äºŒè¿›åˆ¶æ—¥å¿—é—®é¢˜**ï¼š
```sql
-- åœ¨ä¸»åº“æŸ¥çœ‹binlogçŠ¶æ€
SHOW BINARY LOGS;
SHOW MASTER STATUS;

-- æ£€æŸ¥ä»åº“è¯·æ±‚çš„ä½ç½®æ˜¯å¦å­˜åœ¨
SHOW BINLOG EVENTS IN 'mysql-bin.000100' 
FROM 12345 LIMIT 10;
```

### 7.3 åŒæ­¥æ¢å¤æ­¥éª¤


**æ ‡å‡†æ¢å¤æµç¨‹**ï¼š
```sql
-- 1. åœæ­¢ä»åº“åŒæ­¥
STOP SLAVE;

-- 2. é‡æ–°è®¾ç½®ä¸»åº“è¿æ¥
CHANGE MASTER TO
  MASTER_HOST='192.168.1.10',
  MASTER_USER='repl_user',
  MASTER_PASSWORD='password',
  MASTER_AUTO_POSITION=1;

-- 3. å¯åŠ¨åŒæ­¥
START SLAVE;

-- 4. æ£€æŸ¥çŠ¶æ€
SHOW SLAVE STATUS\G
```

**GTIDæ¨¡å¼ä¸‹çš„æ¢å¤**ï¼š
```sql
-- æŸ¥çœ‹GTIDçŠ¶æ€
SELECT $$gtid_mode, $$enforce_gtid_consistency;
SHOW GLOBAL VARIABLES LIKE 'gtid_executed';

-- è·³è¿‡æœ‰é—®é¢˜çš„äº‹åŠ¡(è°¨æ…ä½¿ç”¨)
SET SESSION sql_log_bin=0;
SET GTID_NEXT='3f1ad2c8-8b13-11ea-8c2a-005056a6d3d8:100';
BEGIN; COMMIT;
SET GTID_NEXT='AUTOMATIC';
SET SESSION sql_log_bin=1;
```

### 7.4 é¢„é˜²åŒæ­¥ä¸­æ–­


**ç½‘ç»œä¼˜åŒ–é…ç½®**ï¼š
```ini
# my.cnf ä¸»åº“é…ç½®
[mysqld]
# å¢åŠ ç½‘ç»œç¼“å†²
net_buffer_length = 32K
max_allowed_packet = 64M

# äºŒè¿›åˆ¶æ—¥å¿—ä¿ç•™æ—¶é—´
expire_logs_days = 7
max_binlog_size = 500M

# ä»åº“é…ç½®
slave_net_timeout = 60
slave_compressed_protocol = 1
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šæ¢å¤åŒæ­¥å‰ä¸€å®šè¦ç¡®è®¤æ•°æ®ä¸€è‡´æ€§ï¼Œå¿…è¦æ—¶éœ€è¦é‡æ–°æ­å»ºä»åº“

---

## 8. ğŸ’¾ åˆ‡æ¢æ•°æ®ä¸¢å¤±é¢„é˜²


### 8.1 æ•°æ®ä¸¢å¤±çš„é£é™©ç‚¹


**å¼‚æ­¥å¤åˆ¶å»¶è¿Ÿ**ï¼š
```
æ—¶é—´è½´ç¤ºä¾‹ï¼š
T1: ä¸»åº“æ‰§è¡Œ INSERT INTO orders VALUES (1001, 'item1')
T2: å®¢æˆ·ç«¯æ”¶åˆ° "è®¢å•åˆ›å»ºæˆåŠŸ"
T3: ä¸»åº“æ•…éšœï¼
T4: åˆ‡æ¢åˆ°ä»åº“ï¼Œä½†ä»åº“è¿˜æ²¡æ”¶åˆ°T1çš„æ•°æ®
T5: å®¢æˆ·çœ‹åˆ°è®¢å•æ¶ˆå¤±äº†ï¼
```

**åŠåŒæ­¥å¤åˆ¶å¤±æ•ˆ**ï¼š
```sql
-- æ£€æŸ¥åŠåŒæ­¥çŠ¶æ€
SHOW STATUS LIKE 'Rpl_semi_sync%';

-- åŠåŒæ­¥è¶…æ—¶è®¾ç½®
SET GLOBAL rpl_semi_sync_master_timeout = 1000; -- 1ç§’
```

### 8.2 æ•°æ®ä¸¢å¤±æ£€æµ‹


**GTIDå·®å¼‚æ£€æŸ¥**ï¼š
```sql
-- åœ¨åŸä¸»åº“(å¦‚æœèƒ½è¿æ¥)
SELECT $$gtid_executed as master_gtid;

-- åœ¨æ–°ä¸»åº“
SELECT $$gtid_executed as slave_gtid;

-- è®¡ç®—å·®å¼‚
SELECT GTID_SUBTRACT('master_gtid_value', 'slave_gtid_value') as lost_gtids;
```

**ä¸šåŠ¡æ•°æ®éªŒè¯**ï¼š
```sql
-- æ£€æŸ¥å…³é”®ä¸šåŠ¡è¡¨çš„æœ€æ–°è®°å½•
SELECT MAX(id), MAX(created_time) 
FROM critical_table;

-- å¯¹æ¯”åˆ‡æ¢å‰åçš„æ•°æ®é‡
SELECT COUNT(*) FROM orders 
WHERE created_time >= '2024-01-01 10:00:00';
```

### 8.3 æ•°æ®ä¸¢å¤±é¢„é˜²ç­–ç•¥


**é…ç½®åŠåŒæ­¥å¤åˆ¶**ï¼š
```sql
-- ä¸»åº“é…ç½®
INSTALL PLUGIN rpl_semi_sync_master SONAME 'semisync_master.so';
SET GLOBAL rpl_semi_sync_master_enabled = 1;
SET GLOBAL rpl_semi_sync_master_timeout = 1000;

-- ä»åº“é…ç½®
INSTALL PLUGIN rpl_semi_sync_slave SONAME 'semisync_slave.so';
SET GLOBAL rpl_semi_sync_slave_enabled = 1;
```

**åº”ç”¨å±‚é¢ä¿æŠ¤**ï¼š
```python
# åº”ç”¨ä»£ç ç¤ºä¾‹ï¼šç¡®è®¤å†™å…¥æˆåŠŸ
def create_order_safely(order_data):
    try:
        # 1. å†™å…¥ä¸»åº“
        result = db.execute("INSERT INTO orders VALUES (%s)", order_data)
        
        # 2. éªŒè¯å†™å…¥æˆåŠŸ
        if result.affected_rows == 1:
            # 3. å¯é€‰ï¼šè¯»å–ç¡®è®¤(è¯»ä¸»åº“)
            verify = db.execute("SELECT id FROM orders WHERE id = %s", 
                              [order_data['id']], read_from='master')
            if verify:
                return True
        
        return False
    except Exception as e:
        log.error(f"Order creation failed: {e}")
        return False
```

### 8.4 åˆ‡æ¢å‰æ•°æ®ä¸€è‡´æ€§ç¡®ä¿


**å»¶è¿Ÿæ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# åˆ‡æ¢å‰å»¶è¿Ÿæ£€æŸ¥

check_replication_lag() {
    local lag=$(mysql -h$SLAVE_HOST -e "SHOW SLAVE STATUS\G" | \
                grep "Seconds_Behind_Master" | awk '{print $2}')
    
    if [ "$lag" = "NULL" ]; then
        echo "Replication is broken!"
        return 1
    elif [ $lag -gt 5 ]; then
        echo "Replication lag is $lag seconds, too high!"
        return 1
    else
        echo "Replication lag is acceptable: $lag seconds"
        return 0
    fi
}

# ç­‰å¾…åŒæ­¥è¿½ä¸Š
wait_for_sync() {
    local max_wait=30
    local count=0
    
    while [ $count -lt $max_wait ]; do
        if check_replication_lag; then
            echo "Replication is synced, safe to failover"
            return 0
        fi
        sleep 1
        ((count++))
    done
    
    echo "Timeout waiting for sync"
    return 1
}
```

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨å¢å¼ºåŠåŒæ­¥å¤åˆ¶(Enhanced Semi-sync)æ¥æœ€å¤§ç¨‹åº¦é¿å…æ•°æ®ä¸¢å¤±

---

## 9. ğŸš€ æ•…éšœè½¬ç§»æµç¨‹ä¼˜åŒ–


### 9.1 æ ‡å‡†è½¬ç§»æµç¨‹åˆ†æ


**ä¼ ç»Ÿæµç¨‹æ—¶é—´åˆ†è§£**ï¼š
```
æ•…éšœæ£€æµ‹    30ç§’
æ•…éšœç¡®è®¤    15ç§’  
åœæ­¢åº”ç”¨    10ç§’
æ•°æ®æ£€æŸ¥    20ç§’
æå‡ä»åº“     5ç§’
é…ç½®æ›´æ–°    10ç§’
åº”ç”¨é‡è¿    20ç§’
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡æ—¶é—´   110ç§’
```

### 9.2 æµç¨‹ä¼˜åŒ–ç­–ç•¥


**å¹¶è¡ŒåŒ–å¤„ç†**ï¼š
```
ä¼˜åŒ–åçš„å¹¶è¡Œæµç¨‹ï¼š

æ—¶é—´  ä¸»çº¿ç¨‹              è¾…åŠ©çº¿ç¨‹1           è¾…åŠ©çº¿ç¨‹2
0s    å¼€å§‹æ•…éšœç¡®è®¤        é¢„æ£€æŸ¥ä»åº“çŠ¶æ€      é€šçŸ¥åº”ç”¨å‡†å¤‡åˆ‡æ¢
15s   ç¡®è®¤æ•…éšœ          æ•°æ®ä¸€è‡´æ€§éªŒè¯      VIPå‡†å¤‡åˆ‡æ¢
25s   åœæ­¢åº”ç”¨å†™å…¥       æå‡ä»åº“æƒé™        æ›´æ–°DNSè®°å½•
30s   å¯åŠ¨åº”ç”¨é‡è¿       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      æ›´æ–°ç›‘æ§é…ç½®
40s   éªŒè¯åˆ‡æ¢æˆåŠŸ       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ€»æ—¶é—´ï¼š40ç§’ (èŠ‚çœ70ç§’)
```

**é¢„çƒ­æœºåˆ¶**ï¼š
```bash
#!/bin/bash
# ä»åº“é¢„çƒ­è„šæœ¬ - å®šæœŸæ‰§è¡Œ

# 1. é¢„åŠ è½½å¸¸ç”¨è¡¨åˆ°å†…å­˜
mysql -e "SELECT COUNT(*) FROM user_table" &>/dev/null
mysql -e "SELECT COUNT(*) FROM order_table" &>/dev/null

# 2. é¢„çƒ­è¿æ¥æ± 
for i in {1..10}; do
    mysql -e "SELECT 1" &>/dev/null &
done

# 3. æ£€æŸ¥ç£ç›˜IOæ€§èƒ½
dd if=/dev/zero of=/tmp/iotest bs=1M count=100 &>/dev/null
rm -f /tmp/iotest
```

### 9.3 è‡ªåŠ¨åŒ–åˆ‡æ¢è„šæœ¬


**æ™ºèƒ½åˆ‡æ¢è„šæœ¬**ï¼š
```bash
#!/bin/bash
# è‡ªåŠ¨åŒ–æ•…éšœåˆ‡æ¢è„šæœ¬

MASTER_HOST="192.168.1.10"
SLAVE_HOST="192.168.1.11"
VIP="192.168.1.100"

# å‡½æ•°ï¼šå¥åº·æ£€æŸ¥
health_check() {
    timeout 5 mysql -h$1 -e "SELECT 1" &>/dev/null
    return $?
}

# å‡½æ•°ï¼šåˆ‡æ¢æ‰§è¡Œ
perform_failover() {
    echo "$(date): Starting failover process..."
    
    # 1. åœæ­¢ä»åº“åŒæ­¥
    mysql -h$SLAVE_HOST -e "STOP SLAVE;"
    
    # 2. æå‡ä»åº“ä¸ºä¸»åº“
    mysql -h$SLAVE_HOST -e "
        SET GLOBAL read_only = 0;
        SET GLOBAL super_read_only = 0;
        RESET SLAVE ALL;
    "
    
    # 3. åˆ‡æ¢VIP
    ssh root@$SLAVE_HOST "
        ip addr add $VIP/24 dev eth0
        arping -c 3 -s $VIP $VIP
    "
    
    # 4. éªŒè¯åˆ‡æ¢
    if health_check $VIP; then
        echo "$(date): Failover completed successfully"
        return 0
    else
        echo "$(date): Failover failed!"
        return 1
    fi
}

# ä¸»é€»è¾‘
main() {
    if ! health_check $MASTER_HOST; then
        echo "$(date): Master is down, initiating failover..."
        perform_failover
    else
        echo "$(date): Master is healthy"
    fi
}

main "$@"
```

### 9.4 åˆ‡æ¢çŠ¶æ€ç›‘æ§


**å…³é”®æŒ‡æ ‡è·Ÿè¸ª**ï¼š
```sql
-- åˆ›å»ºåˆ‡æ¢æ—¥å¿—è¡¨
CREATE TABLE failover_log (
    id INT AUTO_INCREMENT PRIMARY KEY,
    event_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    event_type VARCHAR(50),
    old_master VARCHAR(100),
    new_master VARCHAR(100),
    duration_seconds INT,
    success BOOLEAN,
    error_message TEXT
);

-- è®°å½•åˆ‡æ¢äº‹ä»¶
INSERT INTO failover_log 
(event_type, old_master, new_master, duration_seconds, success) 
VALUES 
('automatic_failover', '192.168.1.10', '192.168.1.11', 45, TRUE);
```

---

## 10. â†©ï¸ åˆ‡æ¢å›é€€å¤„ç†æœºåˆ¶


### 10.1 ä»€ä¹ˆæ—¶å€™éœ€è¦å›é€€


**å›é€€è§¦å‘æ¡ä»¶**ï¼š
- ğŸ” å‘ç°åŸä¸»åº“å®é™…æœªæ•…éšœï¼ˆè¯¯åˆ¤ï¼‰
- ğŸ“Š æ–°ä¸»åº“æ€§èƒ½ä¸¥é‡ä¸è¶³
- ğŸ’¥ åˆ‡æ¢åå‡ºç°ä¸¥é‡ä¸šåŠ¡é”™è¯¯
- ğŸ”„ æ•°æ®åŒæ­¥å‡ºç°é‡å¤§é—®é¢˜

### 10.2 å›é€€é£é™©è¯„ä¼°


**æ•°æ®ä¸€è‡´æ€§é£é™©**ï¼š
```
åˆ‡æ¢æœŸé—´æ•°æ®å˜åŒ–ï¼š
åŸä¸»åº“ï¼šå¯èƒ½ä»æœ‰å†™å…¥(å¦‚æœæœªå®Œå…¨éš”ç¦»)
æ–°ä¸»åº“ï¼šå·²ç»å¼€å§‹æ¥å—æ–°çš„å†™å…¥

å›é€€é£é™©ï¼š
- æ•°æ®å†²çª
- ä¸»é”®é‡å¤  
- ä¸šåŠ¡é€»è¾‘ä¸ä¸€è‡´
```

**ä¸šåŠ¡å½±å“è¯„ä¼°**ï¼š
```bash
# è¯„ä¼°è„šæœ¬
#!/bin/bash
evaluate_rollback_risk() {
    # 1. æ£€æŸ¥ä¸¤è¾¹æ•°æ®å·®å¼‚
    local diff_count=$(mysql -h$NEW_MASTER -e "
        SELECT COUNT(*) FROM table_name 
        WHERE updated_time > '$FAILOVER_TIME'
    " -N)
    
    echo "New writes since failover: $diff_count"
    
    # 2. æ£€æŸ¥ä¸šåŠ¡å…³é”®æŒ‡æ ‡
    local error_rate=$(check_application_errors)
    echo "Current error rate: $error_rate%"
    
    # 3. ç»™å‡ºå»ºè®®
    if [ $diff_count -gt 100 ] || [ $error_rate -gt 5 ]; then
        echo "HIGH RISK: Do not rollback"
        return 1
    else
        echo "MODERATE RISK: Rollback possible with data sync"
        return 0
    fi
}
```

### 10.3 å®‰å…¨å›é€€æµç¨‹


**å›é€€æ‰§è¡Œæ­¥éª¤**ï¼š
```bash
#!/bin/bash
# å®‰å…¨å›é€€è„šæœ¬

rollback_failover() {
    echo "Starting rollback process..."
    
    # 1. åœæ­¢åº”ç”¨å†™å…¥æ–°ä¸»åº“
    echo "Stopping application writes..."
    # åº”ç”¨å±‚é…ç½®ä¿®æ”¹æˆ–ä¸´æ—¶ç»´æŠ¤é¡µé¢
    
    # 2. æ•°æ®åŒæ­¥æ£€æŸ¥
    echo "Checking data consistency..."
    pt-table-checksum --host=$NEW_MASTER --host=$OLD_MASTER
    
    # 3. å¦‚æœåŸä¸»åº“å¯ç”¨ï¼ŒåŒæ­¥å·®å¼‚æ•°æ®
    if mysql -h$OLD_MASTER -e "SELECT 1" &>/dev/null; then
        echo "Original master is available, syncing data..."
        pt-table-sync --execute \
            h=$NEW_MASTER \
            h=$OLD_MASTER \
            --databases=production_db
    fi
    
    # 4. åˆ‡æ¢VIPå›åŸä¸»åº“
    echo "Switching VIP back to original master..."
    ssh root@$NEW_MASTER "ip addr del $VIP/24 dev eth0"
    ssh root@$OLD_MASTER "ip addr add $VIP/24 dev eth0"
    
    # 5. é‡æ–°å»ºç«‹ä¸»ä»å…³ç³»
    echo "Re-establishing replication..."
    mysql -h$NEW_MASTER -e "
        CHANGE MASTER TO
            MASTER_HOST='$OLD_MASTER',
            MASTER_AUTO_POSITION=1;
        START SLAVE;
    "
    
    echo "Rollback completed"
}
```

### 10.4 å›é€€åçš„éªŒè¯


**æ•°æ®å®Œæ•´æ€§éªŒè¯**ï¼š
```sql
-- æ£€æŸ¥å…³é”®ä¸šåŠ¡æ•°æ®
SELECT 
    table_name,
    COUNT(*) as record_count,
    MAX(updated_time) as last_update
FROM 
    (SELECT 'users' as table_name, COUNT(*) as cnt, MAX(updated_time) as last_update FROM users
     UNION ALL
     SELECT 'orders' as table_name, COUNT(*), MAX(created_time) FROM orders
     UNION ALL  
     SELECT 'payments' as table_name, COUNT(*), MAX(processed_time) FROM payments
    ) AS summary;
```

**ä¸šåŠ¡åŠŸèƒ½éªŒè¯**ï¼š
```python
# ä¸šåŠ¡éªŒè¯è„šæœ¬
def verify_business_functions():
    tests = {
        'user_login': test_user_authentication(),
        'create_order': test_order_creation(),
        'payment_process': test_payment_flow(),
        'data_query': test_data_consistency()
    }
    
    failed_tests = [test for test, result in tests.items() if not result]
    
    if failed_tests:
        print(f"Rollback verification failed: {failed_tests}")
        return False
    else:
        print("All business functions verified successfully")
        return True
```

> âš ï¸ **é‡è¦è­¦å‘Š**ï¼šå›é€€æ“ä½œé£é™©æé«˜ï¼Œåªæœ‰åœ¨ç¡®ä¿æ•°æ®å®‰å…¨çš„å‰æä¸‹æ‰èƒ½æ‰§è¡Œã€‚å»ºè®®åœ¨å›é€€å‰å¤‡ä»½æ‰€æœ‰ç›¸å…³æ•°æ®ã€‚

---

## 11. ğŸ”„ å¤šå±‚æ•…éšœåˆ‡æ¢ç­–ç•¥


### 11.1 å¤šå±‚æ¶æ„è®¾è®¡


**ä¸‰å±‚åˆ‡æ¢æ¶æ„**ï¼š
```
åº”ç”¨å±‚åˆ‡æ¢ï¼š
å®¢æˆ·ç«¯ â”€â”€â†’ è´Ÿè½½å‡è¡¡å™¨ â”€â”€â†’ åº”ç”¨æœåŠ¡å™¨é›†ç¾¤
                â†“
ä¸­é—´ä»¶åˆ‡æ¢ï¼š        
åº”ç”¨æœåŠ¡å™¨ â”€â”€â†’ æ•°æ®åº“ä¸­é—´ä»¶ â”€â”€â†’ æ•°æ®åº“é›†ç¾¤
                â†“
æ•°æ®åº“åˆ‡æ¢ï¼š
ä¸»åº“ â†â”€â”€åŒæ­¥â”€â”€â†’ ä»åº“1 â†â”€â”€åŒæ­¥â”€â”€â†’ ä»åº“2
```

### 11.2 åˆ‡æ¢ä¼˜å…ˆçº§ç­–ç•¥


**åˆ‡æ¢å†³ç­–æ ‘**ï¼š
```
æ•…éšœæ£€æµ‹
    â†“
åº”ç”¨å±‚å¯åˆ‡æ¢ï¼Ÿ â”€â”€Yesâ”€â”€â†’ åº”ç”¨å±‚åˆ‡æ¢ (å½±å“æœ€å°)
    â†“ No
ä¸­é—´ä»¶å¯åˆ‡æ¢ï¼Ÿ â”€â”€Yesâ”€â”€â†’ ä¸­é—´ä»¶åˆ‡æ¢ (å½±å“ä¸­ç­‰)  
    â†“ No
æ•°æ®åº“åˆ‡æ¢ (å½±å“æœ€å¤§)
```

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# åˆ‡æ¢ç­–ç•¥é…ç½®
failover_strategy:
  layers:
    - name: "application"
      priority: 1
      timeout: 5
      fallback: "middleware"
      
    - name: "middleware" 
      priority: 2
      timeout: 15
      fallback: "database"
      
    - name: "database"
      priority: 3
      timeout: 30
      fallback: null
```

### 11.3 çº§è”æ•…éšœå¤„ç†


**æ•…éšœä¼ æ’­æ§åˆ¶**ï¼š
```bash
# é˜²æ­¢çº§è”æ•…éšœçš„è„šæœ¬
prevent_cascade_failure() {
    local failed_layer=$1
    
    case $failed_layer in
        "database")
            # æ•°æ®åº“æ•…éšœæ—¶ï¼Œé™åˆ¶åº”ç”¨å±‚è¿æ¥
            echo "Database failed, limiting app connections"
            # é€šçŸ¥åº”ç”¨å±‚é™çº§æœåŠ¡
            curl -X POST http://app-server/api/circuit-breaker/enable
            ;;
        "middleware")
            # ä¸­é—´ä»¶æ•…éšœæ—¶ï¼Œåº”ç”¨ç›´è¿æ•°æ®åº“
            echo "Middleware failed, switching to direct DB connection"
            update_app_config "database.direct_connection=true"
            ;;
        "application")
            # åº”ç”¨æ•…éšœæ—¶ï¼Œè¿”å›é™æ€é¡µé¢
            echo "App failed, serving static content"
            nginx_enable_maintenance_mode
            ;;
    esac
}
```

### 11.4 å¤šæ•°æ®ä¸­å¿ƒåˆ‡æ¢


**è·¨æœºæˆ¿æ¶æ„**ï¼š
```
æœºæˆ¿A (ä¸»)          æœºæˆ¿B (å¤‡)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”
   â”‚ä¸»åº“A1 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ä»åº“B1 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”˜
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”  
   â”‚ä»åº“A2 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ä»åº“B2 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ‡æ¢ç­–ç•¥ï¼š
æœ¬åœ°åˆ‡æ¢ï¼šA1æ•…éšœ â†’ A2æå‡ (ç§’çº§)
è·¨æœºæˆ¿åˆ‡æ¢ï¼šæœºæˆ¿Aæ•…éšœ â†’ B1æå‡ (åˆ†é’Ÿçº§)
```

**è·¨æœºæˆ¿åˆ‡æ¢è„šæœ¬**ï¼š
```bash
#!/bin/bash
# è·¨æœºæˆ¿åˆ‡æ¢è„šæœ¬

IDC_A_MASTER="10.1.1.10"
IDC_B_STANDBY="10.2.1.10"
VIP_A="10.1.1.100"
VIP_B="10.2.1.100"

cross_idc_failover() {
    echo "Initiating cross-IDC failover..."
    
    # 1. æ£€æŸ¥æœºæˆ¿Bçš„å‡†å¤‡æƒ…å†µ
    if ! mysql -h$IDC_B_STANDBY -e "SELECT 1" &>/dev/null; then
        echo "ERROR: IDC-B database not ready!"
        return 1
    fi
    
    # 2. æå‡æœºæˆ¿Bä¸ºä¸»åº“
    mysql -h$IDC_B_STANDBY -e "
        STOP SLAVE;
        SET GLOBAL read_only = 0;
        SET GLOBAL super_read_only = 0;
    "
    
    # 3. æ›´æ–°DNSæŒ‡å‘æœºæˆ¿B
    update_dns "mysql.company.com" "$VIP_B"
    
    # 4. é€šçŸ¥åº”ç”¨å±‚åˆ‡æ¢è¿æ¥å­—ç¬¦ä¸²
    notify_applications "mysql.company.com:3306"
    
    echo "Cross-IDC failover completed"
}
```

---

## 12. âš¡ åˆ‡æ¢æ—¶é—´ä¼˜åŒ–æŠ€å·§


### 12.1 åˆ‡æ¢æ—¶é—´åˆ†æ


**æ—¶é—´æ¶ˆè€—åˆ†è§£**ï¼š
```
ä¼ ç»Ÿåˆ‡æ¢æµç¨‹æ—¶é—´åˆ†æï¼š
æ•…éšœæ£€æµ‹: 30s   (30%)  â† æœ€å¤§ä¼˜åŒ–ç©ºé—´
æ•…éšœç¡®è®¤: 15s   (15%)
æ•°æ®æ£€æŸ¥: 25s   (25%)  â† ç¬¬äºŒä¼˜åŒ–ç‚¹  
åˆ‡æ¢æ‰§è¡Œ: 10s   (10%)
åº”ç”¨é‡è¿: 20s   (20%)  â† ç¬¬ä¸‰ä¼˜åŒ–ç‚¹
```

### 12.2 æ£€æµ‹æ—¶é—´ä¼˜åŒ–


**å¿«é€Ÿæ£€æµ‹æœºåˆ¶**ï¼š
```bash
# ä¼˜åŒ–åçš„å¿«é€Ÿæ£€æµ‹è„šæœ¬
fast_health_check() {
    local host=$1
    local timeout=2  # å‡å°‘åˆ°2ç§’
    
    # å¹¶è¡Œæ£€æµ‹å¤šä¸ªæŒ‡æ ‡
    {
        # ç½‘ç»œè¿é€šæ€§
        timeout $timeout bash -c "echo >/dev/tcp/$host/3306" 2>/dev/null
        echo $? > /tmp/network_check &
        
        # MySQLå“åº”
        timeout $timeout mysql -h$host -e "SELECT 1" &>/dev/null
        echo $? > /tmp/mysql_check &
        
        # ç­‰å¾…æ‰€æœ‰æ£€æŸ¥å®Œæˆ
        wait
    }
    
    # è¯„ä¼°ç»“æœ
    local network_ok=$(cat /tmp/network_check 2>/dev/null || echo 1)
    local mysql_ok=$(cat /tmp/mysql_check 2>/dev/null || echo 1)
    
    if [ $network_ok -eq 0 ] && [ $mysql_ok -eq 0 ]; then
        return 0
    else
        return 1
    fi
}
```

**æ™ºèƒ½æ£€æµ‹é¢‘ç‡**ï¼š
```bash
# è‡ªé€‚åº”æ£€æµ‹é—´éš”
adaptive_monitoring() {
    local check_interval=1  # å¼€å§‹1ç§’æ£€æŸ¥ä¸€æ¬¡
    local consecutive_success=0
    
    while true; do
        if fast_health_check $MASTER_HOST; then
            ((consecutive_success++))
            
            # è¿ç»­æˆåŠŸåˆ™é™ä½æ£€æŸ¥é¢‘ç‡
            if [ $consecutive_success -gt 10 ]; then
                check_interval=5  # å»¶é•¿åˆ°5ç§’
            fi
        else
            # ä¸€æ—¦å¤±è´¥ï¼Œç«‹å³æ¢å¤é«˜é¢‘æ£€æŸ¥
            consecutive_success=0
            check_interval=1
            
            # è§¦å‘æ•…éšœå¤„ç†
            handle_failure
        fi
        
        sleep $check_interval
    done
}
```

### 12.3 æ•°æ®æ£€æŸ¥ä¼˜åŒ–


**å¢é‡æ£€æŸ¥ç­–ç•¥**ï¼š
```sql
-- åªæ£€æŸ¥æœ€è¿‘çš„å…³é”®æ•°æ®ï¼Œè€Œéå…¨é‡æ£€æŸ¥
CREATE TABLE sync_checkpoint (
    id INT AUTO_INCREMENT PRIMARY KEY,
    table_name VARCHAR(100),
    last_check_time TIMESTAMP,
    last_max_id BIGINT,
    checksum VARCHAR(32)
);

-- å¿«é€Ÿæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
SELECT 
    table_name,
    COUNT(*) as new_records,
    MAX(id) as current_max_id
FROM critical_table 
WHERE id > (
    SELECT COALESCE(last_max_id, 0) 
    FROM sync_checkpoint 
    WHERE table_name = 'critical_table'
);
```

**å¹¶è¡ŒéªŒè¯**ï¼š
```bash
# å¹¶è¡Œæ£€æŸ¥å¤šä¸ªè¡¨
parallel_data_check() {
    local tables=("users" "orders" "payments" "inventory")
    
    for table in "${tables[@]}"; do
        {
            echo "Checking $table..."
            mysql -e "SELECT COUNT(*) FROM $table" &>/dev/null
            echo "$table: OK"
        } &
    done
    
    # ç­‰å¾…æ‰€æœ‰æ£€æŸ¥å®Œæˆï¼Œæœ€é•¿ç­‰å¾…10ç§’
    timeout 10 wait
}
```

### 12.4 åº”ç”¨é‡è¿ä¼˜åŒ–


**è¿æ¥æ± é¢„çƒ­**ï¼š
```python
# åº”ç”¨å±‚è¿æ¥æ± ä¼˜åŒ–
class FastFailoverConnectionPool:
    def __init__(self):
        self.primary_pool = ConnectionPool(host="master_ip")
        self.secondary_pool = None  # æ‡’åŠ è½½
        
    def prepare_failover(self):
        """é¢„å…ˆå‡†å¤‡å¤‡ç”¨è¿æ¥æ± """
        if not self.secondary_pool:
            self.secondary_pool = ConnectionPool(
                host="slave_ip",
                max_connections=10  # é¢„çƒ­å°‘é‡è¿æ¥
            )
            # é¢„çƒ­è¿æ¥
            for _ in range(5):
                conn = self.secondary_pool.get_connection()
                conn.ping()  # ç¡®ä¿è¿æ¥æœ‰æ•ˆ
                self.secondary_pool.return_connection(conn)
    
    def failover(self):
        """å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡ç”¨æ± """
        old_pool = self.primary_pool
        self.primary_pool = self.secondary_pool
        self.secondary_pool = None
        
        # å¼‚æ­¥å…³é—­æ—§è¿æ¥æ± 
        threading.Thread(target=old_pool.close_all).start()
```

**æ™ºèƒ½é‡è¿æœºåˆ¶**ï¼š
```java
// Javaåº”ç”¨æ™ºèƒ½é‡è¿ç¤ºä¾‹
public class SmartReconnector {
    private static final int[] RETRY_DELAYS = {100, 200, 500, 1000, 2000};
    
    public Connection getConnection() {
        for (int attempt = 0; attempt < RETRY_DELAYS.length; attempt++) {
            try {
                return dataSource.getConnection();
            } catch (SQLException e) {
                if (attempt == RETRY_DELAYS.length - 1) {
                    throw e;  // æœ€åä¸€æ¬¡å°è¯•å¤±è´¥
                }
                
                try {
                    Thread.sleep(RETRY_DELAYS[attempt]);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    throw new RuntimeException(ie);
                }
            }
        }
        return null;
    }
}
```

### 12.5 åˆ‡æ¢æ—¶é—´ç›‘æ§


**æ€§èƒ½æŒ‡æ ‡è·Ÿè¸ª**ï¼š
```sql
-- åˆ‡æ¢æ€§èƒ½ç›‘æ§è¡¨
CREATE TABLE failover_metrics (
    failover_id VARCHAR(50),
    metric_name VARCHAR(100),
    metric_value DECIMAL(10,3),
    recorded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_failover_metric (failover_id, metric_name)
);

-- è®°å½•åˆ‡æ¢æ—¶é—´
INSERT INTO failover_metrics VALUES
('fo-20240101-001', 'detection_time', 15.5, NOW()),
('fo-20240101-001', 'validation_time', 8.2, NOW()),
('fo-20240101-001', 'switch_time', 3.1, NOW()),
('fo-20240101-001', 'recovery_time', 12.7, NOW()),
('fo-20240101-001', 'total_time', 39.5, NOW());
```

> ğŸ’¡ **ä¼˜åŒ–ç›®æ ‡**ï¼šé€šè¿‡è¿™äº›ä¼˜åŒ–æŠ€å·§ï¼Œæ€»åˆ‡æ¢æ—¶é—´å¯ä»¥ä»2-3åˆ†é’Ÿç¼©çŸ­åˆ°30-60ç§’

---

## 13. ğŸ“Š åˆ‡æ¢å½±å“è¯„ä¼°æ–¹æ³•


### 13.1 å½±å“è¯„ä¼°ç»´åº¦


**ä¸šåŠ¡å½±å“è¯„ä¼°æ¡†æ¶**ï¼š
```
å½±å“ç»´åº¦åˆ†æï¼š
    
â”Œâ”€ æ—¶é—´å½±å“ â”€â”    â”Œâ”€ èŒƒå›´å½±å“ â”€â”    â”Œâ”€ ç¨‹åº¦å½±å“ â”€â”
â”‚ åˆ‡æ¢æ—¶é•¿   â”‚    â”‚ å—å½±å“ç”¨æˆ· â”‚    â”‚ æœåŠ¡é™çº§   â”‚
â”‚ æ¢å¤æ—¶é—´   â”‚    â”‚ å½±å“åŠŸèƒ½   â”‚    â”‚ æ•°æ®ä¸¢å¤±   â”‚
â”‚ æ€»ä¸­æ–­æ—¶é—´ â”‚    â”‚ åœ°ç†èŒƒå›´   â”‚    â”‚ æ€§èƒ½ä¸‹é™   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.2 å®æ—¶å½±å“ç›‘æ§


**å…³é”®æŒ‡æ ‡ç›‘æ§**ï¼š
```sql
-- å®æ—¶ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
CREATE VIEW real_time_impact AS
SELECT 
    -- ç”¨æˆ·å½±å“
    COUNT(DISTINCT user_id) as affected_users,
    
    -- äº¤æ˜“å½±å“  
    SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed_transactions,
    SUM(transaction_amount) as affected_revenue,
    
    -- æ€§èƒ½å½±å“
    AVG(response_time_ms) as avg_response_time,
    MAX(response_time_ms) as max_response_time,
    
    -- æ—¶é—´çª—å£
    DATE_FORMAT(created_time, '%H:%i') as time_window
    
FROM application_logs 
WHERE created_time >= DATE_SUB(NOW(), INTERVAL 5 MINUTE)
GROUP BY DATE_FORMAT(created_time, '%H:%i')
ORDER BY created_time DESC;
```

**è‡ªåŠ¨åŒ–å½±å“æ£€æµ‹**ï¼š
```python
def assess_failover_impact():
    """è¯„ä¼°æ•…éšœåˆ‡æ¢çš„ä¸šåŠ¡å½±å“"""
    
    # è·å–åˆ‡æ¢æ—¶é—´çª—å£
    failover_start = get_failover_start_time()
    failover_end = get_failover_end_time()
    
    # è®¡ç®—å„é¡¹å½±å“æŒ‡æ ‡
    impact_metrics = {
        'duration_seconds': (failover_end - failover_start).total_seconds(),
        'affected_users': count_affected_users(failover_start, failover_end),
        'failed_requests': count_failed_requests(failover_start, failover_end),
        'revenue_loss': calculate_revenue_impact(failover_start, failover_end),
        'sla_breach': check_sla_violation(failover_start, failover_end)
    }
    
    # å½±å“ç­‰çº§è¯„ä¼°
    impact_level = classify_impact_level(impact_metrics)
    
    return {
        'metrics': impact_metrics,
        'level': impact_level,
        'recommendations': generate_recommendations(impact_metrics)
    }
```

### 13.3 ç”¨æˆ·ä½“éªŒå½±å“åˆ†æ


**ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼š
```sql
-- åˆ‡æ¢æœŸé—´ç”¨æˆ·è¡Œä¸ºå˜åŒ–
WITH failover_window AS (
    SELECT '2024-01-01 10:15:00' as start_time,
           '2024-01-01 10:18:00' as end_time
),
user_behavior AS (
    SELECT 
        user_id,
        COUNT(*) as total_requests,
        SUM(CASE WHEN response_code >= 400 THEN 1 ELSE 0 END) as error_requests,
        AVG(response_time) as avg_response_time,
        MIN(request_time) as first_request,
        MAX(request_time) as last_request
    FROM user_requests ur, failover_window fw
    WHERE ur.request_time BETWEEN fw.start_time AND fw.end_time
    GROUP BY user_id
)
SELECT 
    COUNT(*) as total_affected_users,
    AVG(error_requests * 100.0 / total_requests) as avg_error_rate,
    AVG(avg_response_time) as avg_response_time,
    COUNT(CASE WHEN error_requests > 0 THEN 1 END) as users_with_errors
FROM user_behavior;
```

**å®¢æˆ·æŠ•è¯‰è·Ÿè¸ª**ï¼š
```python
def track_customer_complaints():
    """è·Ÿè¸ªåˆ‡æ¢æœŸé—´çš„å®¢æˆ·æŠ•è¯‰"""
    
    complaints = {
        'total_complaints': get_complaint_count(),
        'complaint_categories': {
            'connection_timeout': 45,
            'slow_response': 23,
            'data_inconsistency': 8,
            'feature_unavailable': 12
        },
        'resolution_time': calculate_avg_resolution_time(),
        'customer_satisfaction': get_satisfaction_score()
    }
    
    return complaints
```

### 13.4 ä¸šåŠ¡è¿ç»­æ€§è¯„ä¼°


**æœåŠ¡å¯ç”¨æ€§è®¡ç®—**ï¼š
```python
def calculate_availability_impact(failover_duration_seconds):
    """è®¡ç®—å¯¹æœåŠ¡å¯ç”¨æ€§çš„å½±å“"""
    
    # æœˆåº¦æ€»æ—¶é—´ï¼ˆç§’ï¼‰
    month_seconds = 30 * 24 * 3600  # 2,592,000ç§’
    
    # è®¡ç®—å¯ç”¨æ€§ç™¾åˆ†æ¯”
    availability = (month_seconds - failover_duration_seconds) / month_seconds * 100
    
    # SLAç­‰çº§åˆ¤æ–­
    sla_levels = {
        99.99: "4ä¸ª9",  # å…è®¸52åˆ†é’Ÿ/å¹´
        99.95: "3ä¸ª9+", # å…è®¸4.3å°æ—¶/å¹´  
        99.9: "3ä¸ª9",   # å…è®¸8.8å°æ—¶/å¹´
        99.0: "2ä¸ª9"    # å…è®¸3.6å¤©/å¹´
    }
    
    current_sla = None
    for threshold, level in sorted(sla_levels.items(), reverse=True):
        if availability >= threshold:
            current_sla = level
            break
    
    return {
        'availability_percentage': round(availability, 4),
        'downtime_seconds': failover_duration_seconds,
        'sla_level': current_sla,
        'annual_allowance_seconds': month_seconds * 12 * (100 - availability) / 100
    }
```

**è´¢åŠ¡å½±å“è¯„ä¼°**ï¼š
```sql
-- è´¢åŠ¡å½±å“åˆ†æ
WITH revenue_baseline AS (
    -- æ­£å¸¸æ—¶æ®µçš„æ”¶å…¥åŸºçº¿
    SELECT AVG(hourly_revenue) as baseline_revenue
    FROM hourly_revenue_stats 
    WHERE hour_time BETWEEN 
        DATE_SUB('2024-01-01 10:15:00', INTERVAL 7 DAY) 
        AND '2024-01-01 10:15:00'
        AND HOUR(hour_time) = 10  -- åŒä¸€å°æ—¶å¯¹æ¯”
),
actual_impact AS (
    -- å®é™…å½±å“æœŸé—´æ”¶å…¥
    SELECT SUM(revenue) as actual_revenue
    FROM transactions 
    WHERE created_time BETWEEN '2024-01-01 10:15:00' AND '2024-01-01 10:18:00'
)
SELECT 
    rb.baseline_revenue * (3/60.0) as expected_revenue,  -- 3åˆ†é’Ÿé¢„æœŸæ”¶å…¥
    ai.actual_revenue,
    (rb.baseline_revenue * (3/60.0) - ai.actual_revenue) as revenue_loss,
    ((rb.baseline_revenue * (3/60.0) - ai.actual_revenue) / (rb.baseline_revenue * (3/60.0))) * 100 as loss_percentage
FROM revenue_baseline rb, actual_impact ai;
```

### 13.5 å½±å“æŠ¥å‘Šç”Ÿæˆ


**è‡ªåŠ¨åŒ–æŠ¥å‘Šæ¨¡æ¿**ï¼š
```python
def generate_impact_report(failover_id):
    """ç”Ÿæˆæ•…éšœåˆ‡æ¢å½±å“æŠ¥å‘Š"""
    
    report = {
        'executive_summary': {
            'incident_id': failover_id,
            'start_time': '2024-01-01 10:15:00',
            'end_time': '2024-01-01 10:18:00',
            'total_duration': '3åˆ†é’Ÿ',
            'severity_level': 'P2 - High',
            'services_affected': ['ç”¨æˆ·ç™»å½•', 'è®¢å•å¤„ç†', 'æ”¯ä»˜ç³»ç»Ÿ']
        },
        
        'technical_details': {
            'root_cause': 'ä¸»æ•°æ®åº“æœåŠ¡å™¨ç¡¬ä»¶æ•…éšœ',
            'detection_time': '30ç§’',
            'response_time': '2åˆ†é’Ÿ',
            'recovery_method': 'è‡ªåŠ¨æ•…éšœåˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®åº“'
        },
        
        'business_impact': {
            'affected_users': 1250,
            'failed_transactions': 89,
            'revenue_loss': '$3,450',
            'sla_status': 'æœˆåº¦SLAå—å½±å“ï¼Œä½†ä»åœ¨å¹´åº¦ç›®æ ‡å†…'
        },
        
        'lessons_learned': [
            'éœ€è¦ä¼˜åŒ–æ•…éšœæ£€æµ‹æ—¶é—´',
            'è€ƒè™‘å¢åŠ æ›´å¤šå¥åº·æ£€æŸ¥æŒ‡æ ‡', 
            'åŠ å¼ºç›‘æ§å‘Šè­¦æœºåˆ¶'
        ],
        
        'action_items': [
            {'task': 'ä¼˜åŒ–å¥åº·æ£€æŸ¥è„šæœ¬', 'owner': 'DBAå›¢é˜Ÿ', 'due_date': '2024-01-15'},
            {'task': 'å¢åŠ ç›‘æ§æŒ‡æ ‡', 'owner': 'è¿ç»´å›¢é˜Ÿ', 'due_date': '2024-01-20'}
        ]
    }
    
    return report
```

> ğŸ“Š **è¯„ä¼°ä»·å€¼**ï¼šå®Œæ•´çš„å½±å“è¯„ä¼°æœ‰åŠ©äºï¼š
> - å‘ç®¡ç†å±‚æŠ¥å‘Šäº‹æ•…å½±å“
> - æŒ‡å¯¼åç»­æ”¹è¿›å·¥ä½œ
> - ä¼˜åŒ–æ•…éšœåˆ‡æ¢ç­–ç•¥
> - è¯æ˜é«˜å¯ç”¨æŠ•èµ„çš„å¿…è¦æ€§

---

## 14. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 14.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•…éšœåˆ‡æ¢æœ¬è´¨ï¼šç³»ç»Ÿè‡ªåŠ¨å°†æœåŠ¡ä»æ•…éšœèŠ‚ç‚¹è¿ç§»åˆ°å¥åº·èŠ‚ç‚¹
ğŸ”¸ åˆ‡æ¢è§¦å‘æ¡ä»¶ï¼šç¡¬ä»¶æ•…éšœã€è½¯ä»¶å¼‚å¸¸ã€æ€§èƒ½é—®é¢˜ã€ç½‘ç»œä¸­æ–­
ğŸ”¸ å…³é”®æŠ€æœ¯è¦ç´ ï¼šå¥åº·æ£€æŸ¥ã€VIPæ¼‚ç§»ã€æ•°æ®åŒæ­¥ã€åº”ç”¨é‡è¿
ğŸ”¸ å¸¸è§æ•…éšœç±»å‹ï¼šä¸»ä»åˆ‡æ¢å¤±è´¥ã€è„‘è£‚ã€è¯¯è§¦å‘ã€æ•°æ®ä¸¢å¤±
ğŸ”¸ ä¼˜åŒ–é‡ç‚¹æ–¹å‘ï¼šæ£€æµ‹æ—¶é—´ã€åˆ‡æ¢é€Ÿåº¦ã€æ•°æ®ä¸€è‡´æ€§ã€å½±å“èŒƒå›´
```

### 14.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ•…éšœåˆ‡æ¢çš„æƒè¡¡**
```
å¯ç”¨æ€§ vs ä¸€è‡´æ€§ï¼š
â€¢ å¿«é€Ÿåˆ‡æ¢ â†’ é«˜å¯ç”¨ï¼Œä½†å¯èƒ½æœ‰æ•°æ®ä¸¢å¤±é£é™©
â€¢ è°¨æ…åˆ‡æ¢ â†’ æ•°æ®å®‰å…¨ï¼Œä½†åˆ‡æ¢æ—¶é—´è¾ƒé•¿
â€¢ éœ€è¦æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹æ‰¾åˆ°å¹³è¡¡ç‚¹

è‡ªåŠ¨ vs æ‰‹åŠ¨ï¼š
â€¢ è‡ªåŠ¨åˆ‡æ¢ â†’ å“åº”å¿«ï¼Œä½†å¯èƒ½è¯¯åˆ¤
â€¢ æ‰‹åŠ¨åˆ‡æ¢ â†’ å‡†ç¡®æ€§é«˜ï¼Œä½†å“åº”æ…¢
â€¢ ç”Ÿäº§ç¯å¢ƒå»ºè®®è‡ªåŠ¨+äººå·¥ç¡®è®¤çš„æ··åˆæ¨¡å¼
```

**ğŸ”¹ é¢„é˜²èƒœäºæ²»ç–—**
```
ç›‘æ§é¢„è­¦ï¼š
â€¢ æå‰å‘ç°æ½œåœ¨é—®é¢˜
â€¢ é¢„é˜²æ€§ç»´æŠ¤é™ä½æ•…éšœæ¦‚ç‡
â€¢ å®Œå–„çš„ç›‘æ§ä½“ç³»æ˜¯åŸºç¡€

å®¹é‡è§„åˆ’ï¼š
â€¢ ç¡®ä¿å¤‡ç”¨èŠ‚ç‚¹æœ‰è¶³å¤Ÿå®¹é‡
â€¢ å®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
â€¢ éªŒè¯åˆ‡æ¢æµç¨‹çš„æœ‰æ•ˆæ€§
```

**ğŸ”¹ æ•°æ®å®‰å…¨ä¼˜å…ˆ**
```
åˆ‡æ¢å†³ç­–åŸåˆ™ï¼š
1. æ•°æ®å®‰å…¨ > æœåŠ¡å¯ç”¨æ€§
2. ç¡®è®¤æ•…éšœ > å¿«é€Ÿå“åº”  
3. å½±å“å¯æ§ > åˆ‡æ¢é€Ÿåº¦

æ•°æ®ä¿æŠ¤æªæ–½ï¼š
â€¢ åŠåŒæ­¥å¤åˆ¶å‡å°‘æ•°æ®ä¸¢å¤±
â€¢ åˆ‡æ¢å‰æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
â€¢ å®Œæ•´çš„æ•°æ®å¤‡ä»½ç­–ç•¥
```

### 14.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ åˆ‡æ¢ç­–ç•¥é€‰æ‹©**
```
å°å‹åº”ç”¨ï¼š
â€¢ ç®€å•ä¸»ä»æ¶æ„
â€¢ æ‰‹åŠ¨åˆ‡æ¢ä¸ºä¸»
â€¢ é‡ç‚¹å…³æ³¨æ•°æ®å®‰å…¨

ä¸­å‹åº”ç”¨ï¼š
â€¢ å¢åŠ ç›‘æ§å’Œè‡ªåŠ¨åŒ–
â€¢ åŠè‡ªåŠ¨åˆ‡æ¢æ¨¡å¼
â€¢ å¹³è¡¡å¯ç”¨æ€§å’Œå®‰å…¨æ€§

å¤§å‹åº”ç”¨ï¼š
â€¢ å¤šå±‚æ¶æ„è®¾è®¡
â€¢ å…¨è‡ªåŠ¨åˆ‡æ¢æœºåˆ¶
â€¢ å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦
```

**ğŸ› ï¸ è¿ç»´æœ€ä½³å®è·µ**
```
æ—¥å¸¸ç»´æŠ¤ï¼š
â€¢ å®šæœŸæ£€æŸ¥ä¸»ä»åŒæ­¥çŠ¶æ€
â€¢ ç›‘æ§å¤åˆ¶å»¶è¿Ÿå’Œé”™è¯¯
â€¢ éªŒè¯å¤‡ç”¨èŠ‚ç‚¹çš„å¯ç”¨æ€§

æ•…éšœæ¼”ç»ƒï¼š
â€¢ æœˆåº¦åˆ‡æ¢æ¼”ç»ƒ
â€¢ æµ‹è¯•å„ç§æ•…éšœåœºæ™¯
â€¢ éªŒè¯åˆ‡æ¢æ—¶é—´å’Œæ•°æ®ä¸€è‡´æ€§

æ–‡æ¡£å®Œå–„ï¼š
â€¢ è¯¦ç»†çš„æ“ä½œæ‰‹å†Œ
â€¢ æ•…éšœå¤„ç†æµç¨‹
â€¢ è”ç³»äººå’Œå‡çº§æœºåˆ¶
```

**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```
å¥åº·çŠ¶æ€ï¼š
â€¢ MySQLæœåŠ¡å¯ç”¨æ€§
â€¢ ä¸»ä»åŒæ­¥çŠ¶æ€
â€¢ å¤åˆ¶å»¶è¿Ÿæ—¶é—´
â€¢ è¿æ¥æ•°å’Œæ€§èƒ½æŒ‡æ ‡

åˆ‡æ¢æŒ‡æ ‡ï¼š
â€¢ æ•…éšœæ£€æµ‹æ—¶é—´
â€¢ åˆ‡æ¢æ‰§è¡Œæ—¶é—´
â€¢ æ•°æ®ä¸¢å¤±é‡
â€¢ ä¸šåŠ¡å½±å“èŒƒå›´

æ€§èƒ½æŒ‡æ ‡ï¼š
â€¢ å“åº”æ—¶é—´å˜åŒ–
â€¢ é”™è¯¯ç‡ç»Ÿè®¡
â€¢ ç”¨æˆ·å½±å“æ•°é‡
â€¢ æ”¶å…¥æŸå¤±è¯„ä¼°
```

### 14.4 æ•…éšœå¤„ç†å¿ƒå¾—


**ğŸš¨ ç´§æ€¥å¤„ç†åŸåˆ™**
```
å†·é™åˆ†æï¼š
â€¢ ä¸è¦æ€¥äºåˆ‡æ¢ï¼Œå…ˆç¡®è®¤çœŸæ­£çš„æ•…éšœåŸå› 
â€¢ è¯„ä¼°åˆ‡æ¢é£é™©å’Œä¸šåŠ¡å½±å“
â€¢ è€ƒè™‘æ˜¯å¦æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆ

æ²Ÿé€šåè°ƒï¼š
â€¢ åŠæ—¶é€šçŸ¥ç›¸å…³å›¢é˜Ÿå’Œä¸šåŠ¡æ–¹
â€¢ è¯´æ˜æ•…éšœå½±å“èŒƒå›´å’Œé¢„è®¡æ¢å¤æ—¶é—´
â€¢ å®šæœŸæ›´æ–°å¤„ç†è¿›å±•

è®°å½•æ€»ç»“ï¼š
â€¢ è¯¦ç»†è®°å½•æ•…éšœç°è±¡å’Œå¤„ç†è¿‡ç¨‹
â€¢ åˆ†ææ ¹æœ¬åŸå› å’Œæ”¹è¿›æªæ–½
â€¢ æ›´æ–°æ“ä½œæ–‡æ¡£å’Œåº”æ€¥é¢„æ¡ˆ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ•…éšœåˆ‡æ¢è¦è°¨æ…ï¼Œæ•°æ®å®‰å…¨æ˜¯æ ¹æœ¬
- ç›‘æ§é¢„è­¦è¦åˆ°ä½ï¼Œè‡ªåŠ¨åˆ‡æ¢éœ€äººå·¥
- ä¸»ä»åŒæ­¥å¸¸æ£€æŸ¥ï¼Œå»¶è¿Ÿè¿‡å¤§è¦æ³¨æ„  
- åˆ‡æ¢æ¼”ç»ƒè¦å®šæœŸï¼Œæµç¨‹æ–‡æ¡£è¦å®Œå–„
- æ•…éšœå¤„ç†è«æ…Œå¼ ï¼Œåˆ†æåŸå› å†è¡ŒåŠ¨

**ğŸ’¡ æœ€ç»ˆå»ºè®®**ï¼š
- é«˜å¯ç”¨ä¸æ˜¯ä¸€åŠ³æ°¸é€¸ï¼Œéœ€è¦æŒç»­ä¼˜åŒ–å’Œæ”¹è¿›
- æŠ€æœ¯æ–¹æ¡ˆè¦ä¸ä¸šåŠ¡éœ€æ±‚åŒ¹é…ï¼Œé¿å…è¿‡åº¦è®¾è®¡
- å›¢é˜ŸæŠ€èƒ½åŸ¹å…»å’ŒçŸ¥è¯†å…±äº«åŒæ ·é‡è¦
- å®šæœŸå›é¡¾å’Œæ€»ç»“ï¼Œä¸æ–­æå‡æ•…éšœå¤„ç†èƒ½åŠ›

> ğŸ¯ **å­¦ä¹ ç›®æ ‡æ£€æŸ¥**ï¼š
> - [x] ç†è§£é«˜å¯ç”¨æ•…éšœåˆ‡æ¢çš„åŸºæœ¬æ¦‚å¿µå’Œå·¥ä½œåŸç†
> - [x] æŒæ¡å¸¸è§æ•…éšœçš„æ’æŸ¥å’Œå¤„ç†æ–¹æ³•
> - [x] å­¦ä¼šä¼˜åŒ–åˆ‡æ¢æ—¶é—´å’Œå‡å°‘ä¸šåŠ¡å½±å“
> - [x] å»ºç«‹å®Œæ•´çš„ç›‘æ§å’Œè¯„ä¼°ä½“ç³»
> - [x] å½¢æˆè§„èŒƒçš„æ•…éšœå¤„ç†æµç¨‹

---

## ğŸ“– å»¶ä¼¸é˜…è¯»


**ç›¸å…³æŠ€æœ¯æ–‡æ¡£**ï¼š
- MySQLå®˜æ–¹æ–‡æ¡£ï¼š[MySQL High Availability](https://dev.mysql.com/doc/mysql-ha-scalability/en/)
- Perconaå·¥å…·é›†ï¼š[pt-heartbeat](https://docs.percona.com/percona-toolkit/pt-heartbeat.html)
- ç›‘æ§æ–¹æ¡ˆï¼š[Prometheus + Grafana MySQLç›‘æ§](https://grafana.com/grafana/dashboards/7362)

**æ¨èå®è·µæ¡ˆä¾‹**ï¼š
- é˜¿é‡Œäº‘RDSé«˜å¯ç”¨æ¶æ„è®¾è®¡
- ç¾å›¢æ•°æ®åº“é«˜å¯ç”¨å®è·µ
- å¾®ä¿¡åå°MySQLé«˜å¯ç”¨æ–¹æ¡ˆ

> ğŸ“š **ä¸‹ä¸€æ­¥å­¦ä¹ **ï¼š
> - MySQLé›†ç¾¤æ–¹æ¡ˆï¼ˆPXCã€MGRï¼‰
> - æ•°æ®åº“ä¸­é—´ä»¶ï¼ˆMyCATã€Sharding-JDBCï¼‰
> - äº‘åŸç”Ÿæ•°æ®åº“é«˜å¯ç”¨ï¼ˆKubernetes Operatorï¼‰