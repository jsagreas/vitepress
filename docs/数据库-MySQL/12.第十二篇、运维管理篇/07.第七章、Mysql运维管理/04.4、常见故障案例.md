---
title: 4ã€å¸¸è§æ•…éšœæ¡ˆä¾‹
---
## ğŸ“š ç›®å½•


1. [è¿æ¥é—®é¢˜æ•…éšœå¤„ç†](#1-è¿æ¥é—®é¢˜æ•…éšœå¤„ç†)
2. [é”ç­‰å¾…å’Œæ­»é”é—®é¢˜](#2-é”ç­‰å¾…å’Œæ­»é”é—®é¢˜)
3. [ä¸»ä»åŒæ­¥æ•…éšœ](#3-ä¸»ä»åŒæ­¥æ•…éšœ)
4. [ç³»ç»Ÿèµ„æºé—®é¢˜](#4-ç³»ç»Ÿèµ„æºé—®é¢˜)
5. [æ•°æ®æŸåæ¢å¤](#5-æ•°æ®æŸåæ¢å¤)
6. [é…ç½®ç›¸å…³é”™è¯¯](#6-é…ç½®ç›¸å…³é”™è¯¯)
7. [æ€§èƒ½é—®é¢˜è¯Šæ–­](#7-æ€§èƒ½é—®é¢˜è¯Šæ–­)
8. [æ•…éšœæ’æŸ¥æ–¹æ³•è®º](#8-æ•…éšœæ’æŸ¥æ–¹æ³•è®º)

---

# ğŸ“– ç« èŠ‚æ¦‚è¿°



MySQLè¿ç»´è¿‡ç¨‹ä¸­ï¼Œæ•…éšœæ˜¯æ— æ³•é¿å…çš„ã€‚æŒæ¡å¸¸è§æ•…éšœçš„è¯Šæ–­å’Œå¤„ç†æ–¹æ³•ï¼Œæ˜¯æ¯ä¸ªMySQLè¿ç»´äººå‘˜çš„å¿…å¤‡æŠ€èƒ½ã€‚æœ¬ç« å°†ä»å®æˆ˜è§’åº¦å‡ºå‘ï¼Œè¯¦ç»†è®²è§£å„ç±»å¸¸è§æ•…éšœçš„ç—‡çŠ¶ã€åŸå› ã€è¯Šæ–­æ–¹æ³•å’Œè§£å†³æ–¹æ¡ˆã€‚

---

## 1. ğŸ”Œ è¿æ¥é—®é¢˜æ•…éšœå¤„ç†



### 1.1 è¿æ¥è¶…æ—¶æ•…éšœ



**æ•…éšœç°è±¡**ï¼šå®¢æˆ·ç«¯è¿æ¥MySQLæ—¶å‡ºç°è¶…æ—¶é”™è¯¯

```
ERROR 2003 (HY000): Can't connect to MySQL server on 'localhost' (10060)
```

**é€šä¿—è§£é‡Š**ï¼šå°±åƒæ‰“ç”µè¯æ—¶å¯¹æ–¹ä¸€ç›´å çº¿æˆ–è€…æ²¡äººæ¥å¬ä¸€æ ·ï¼Œå®¢æˆ·ç«¯æƒ³è¿æ¥MySQLæœåŠ¡å™¨ï¼Œä½†æ˜¯æœåŠ¡å™¨æ²¡æœ‰å“åº”æˆ–å“åº”å¤ªæ…¢ã€‚

**å¸¸è§åŸå› ä¸è§£å†³æ–¹æ¡ˆ**ï¼š

```
ç½‘ç»œå±‚é¢é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®¢æˆ·ç«¯ â”€â”€Xâ”€â”€> é˜²ç«å¢™ â”€â”€Xâ”€â”€> MySQLæœåŠ¡å™¨      â”‚
â”‚                                             â”‚
â”‚ æ£€æŸ¥è¦ç‚¹ï¼š                                   â”‚
â”‚ â€¢ é˜²ç«å¢™æ˜¯å¦å¼€æ”¾3306ç«¯å£                     â”‚
â”‚ â€¢ ç½‘ç»œæ˜¯å¦ç•…é€š (pingæµ‹è¯•)                    â”‚
â”‚ â€¢ DNSè§£ææ˜¯å¦æ­£ç¡®                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€

systemctl status mysqld

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬

netstat -tuln | grep 3306

# 3. æµ‹è¯•ç½‘ç»œè¿é€šæ€§

telnet mysql_host 3306

# 4. æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€

firewall-cmd --list-ports
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **æœåŠ¡æœªå¯åŠ¨**ï¼š`systemctl start mysqld`
- **ç«¯å£è¢«å ç”¨**ï¼šä¿®æ”¹MySQLç«¯å£æˆ–æ¸…ç†å ç”¨è¿›ç¨‹
- **é˜²ç«å¢™é˜»æŒ¡**ï¼š`firewall-cmd --add-port=3306/tcp --permanent`

### 1.2 è¿æ¥æ•°è¿‡å¤šé—®é¢˜



**æ•…éšœç°è±¡**ï¼š
```
ERROR 1040 (HY000): Too many connections
```

**é€šä¿—è§£é‡Š**ï¼šMySQLå°±åƒä¸€ä¸ªé¤å…ï¼Œåªæœ‰æœ‰é™çš„åº§ä½ï¼ˆè¿æ¥æ•°ï¼‰ã€‚å½“å®¢æˆ·å¤ªå¤šæ—¶ï¼Œæ–°å®¢æˆ·å°±æ— æ³•è¿›å…¥ç”¨é¤ã€‚

**è¯Šæ–­æ–¹æ³•**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥æ•°å’Œæœ€å¤§è¿æ¥æ•°
SHOW STATUS LIKE 'Threads_connected';
SHOW VARIABLES LIKE 'max_connections';

-- æŸ¥çœ‹è¿æ¥è¯¦æƒ…
SHOW PROCESSLIST;
```

**è§£å†³ç­–ç•¥**ï¼š

| å¤„ç†æ–¹å¼ | é€‚ç”¨åœºæ™¯ | æ“ä½œæ–¹æ³• |
|---------|---------|---------|
| **ä¸´æ—¶æ‰©å®¹** | ç´§æ€¥æƒ…å†µ | `SET GLOBAL max_connections = 500;` |
| **æ¸…ç†æ— æ•ˆè¿æ¥** | æœ‰åƒµå°¸è¿æ¥ | `KILL CONNECTION è¿æ¥ID;` |
| **ä¼˜åŒ–åº”ç”¨** | é•¿æœŸè§£å†³ | ä½¿ç”¨è¿æ¥æ± ã€å‡å°‘è¿æ¥ä¿æŒæ—¶é—´ |

### 1.3 è¿æ¥æ± è€—å°½é—®é¢˜



**é€šä¿—è§£é‡Š**ï¼šåº”ç”¨ç¨‹åºä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œå°±åƒåœè½¦åœºç®¡ç†è½¦ä½ã€‚å½“è½¦ä½ï¼ˆè¿æ¥ï¼‰å…¨éƒ¨è¢«å ç”¨ä¸”æ²¡æœ‰åŠæ—¶å½’è¿˜æ—¶ï¼Œæ–°çš„è¯·æ±‚å°±æ— æ³•è·å¾—è¿æ¥ã€‚

**æ•…éšœè¡¨ç°**ï¼š
- åº”ç”¨å“åº”ç¼“æ…¢
- å¤§é‡"ç­‰å¾…è·å–æ•°æ®åº“è¿æ¥"çš„æ—¥å¿—
- æ•°æ®åº“è¿æ¥æ•°æ­£å¸¸ä½†åº”ç”¨æ— æ³•è·å–è¿æ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// è¿æ¥æ± é…ç½®ä¼˜åŒ–ç¤ºä¾‹
datasource:
  hikari:
    maximum-pool-size: 20        # æœ€å¤§è¿æ¥æ•°
    minimum-idle: 5              # æœ€å°ç©ºé—²è¿æ¥
    connection-timeout: 30000    # è¿æ¥è¶…æ—¶30ç§’
    idle-timeout: 600000         # ç©ºé—²è¶…æ—¶10åˆ†é’Ÿ
    max-lifetime: 1800000        # è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ30åˆ†é’Ÿ
```

### 1.4 MySQL Gone Awayé”™è¯¯



**æ•…éšœç°è±¡**ï¼š
```
ERROR 2006 (HY000): MySQL server has gone away
```

**é€šä¿—è§£é‡Š**ï¼šå°±åƒåœ¨é€šè¯è¿‡ç¨‹ä¸­å¯¹æ–¹çªç„¶æŒ‚æ–­ç”µè¯ä¸€æ ·ï¼ŒMySQLæœåŠ¡å™¨ä¸»åŠ¨æ–­å¼€äº†è¿æ¥ã€‚

**å¸¸è§åŸå› **ï¼š

```
åŸå› åˆ†æå›¾ï¼š
å®¢æˆ·ç«¯æ‰§è¡ŒSQL â”€â”€â”€â”€â”€â”€â”
                   â”‚
                   â–¼
              è¶…æ—¶æ£€æŸ¥æœºåˆ¶
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼         â–¼         â–¼
     æ‰§è¡Œè¶…æ—¶   ç©ºé—²è¶…æ—¶   ç½‘ç»œä¸­æ–­
         â”‚         â”‚         â”‚
         â–¼         â–¼         â–¼
    æŸ¥è¯¢å¤ªå¤æ‚   è¿æ¥é—²ç½®   ç½‘ç»œä¸ç¨³å®š
```

**æ’æŸ¥ä¸è§£å†³**ï¼š
```sql
-- æ£€æŸ¥è¶…æ—¶é…ç½®
SHOW VARIABLES LIKE '%timeout%';

-- è°ƒæ•´å…³é”®å‚æ•°
SET GLOBAL wait_timeout = 28800;
SET GLOBAL interactive_timeout = 28800;
SET GLOBAL max_allowed_packet = 64M;
```

---

## 2. ğŸ”’ é”ç­‰å¾…å’Œæ­»é”é—®é¢˜



### 2.1 è¡¨é”ç­‰å¾…è¶…æ—¶



**æ•…éšœç°è±¡**ï¼š
```
ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
```

**é€šä¿—è§£é‡Š**ï¼šå°±åƒæ’é˜Ÿç­‰å•æ‰€ï¼Œå‰é¢çš„äººå ç”¨å¤ªä¹…ï¼Œåé¢çš„äººç­‰ä¸åŠäº†ã€‚æ•°æ®åº“ä¸­æŸä¸ªäº‹åŠ¡é•¿æ—¶é—´å ç”¨è¡¨é”ï¼Œå…¶ä»–äº‹åŠ¡ç­‰å¾…è¶…æ—¶ã€‚

**é”ç­‰å¾…æœºåˆ¶å›¾è§£**ï¼š
```
äº‹åŠ¡A â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â–¶ (é•¿æ—¶é—´æŒæœ‰é”)
                            â”‚
äº‹åŠ¡B â”…â”…â”…â”…â–¶ ç­‰å¾…é” â”…â”…â”…â”…â–¶ è¶…æ—¶å¤±è´¥
                            â”‚
äº‹åŠ¡C â”…â”…â”…â”…â–¶ ç­‰å¾…é” â”…â”…â”…â”…â–¶ æ’é˜Ÿç­‰å¾…
```

**è¯Šæ–­æ­¥éª¤**ï¼š
```sql
-- 1. æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ
SELECT * FROM information_schema.INNODB_LOCKS;
SELECT * FROM information_schema.INNODB_LOCK_WAITS;

-- 2. æŸ¥çœ‹äº‹åŠ¡çŠ¶æ€
SELECT * FROM information_schema.INNODB_TRX;

-- 3. æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„SQL
SHOW FULL PROCESSLIST;
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ‰¾åˆ°å ç”¨é”çš„äº‹åŠ¡IDå¹¶ç»ˆæ­¢
KILL äº‹åŠ¡å¯¹åº”çš„è¿æ¥ID;

-- è°ƒæ•´é”ç­‰å¾…è¶…æ—¶æ—¶é—´
SET GLOBAL innodb_lock_wait_timeout = 120;
```

### 2.2 æ­»é”é—®é¢˜è¯Šæ–­æµç¨‹



**é€šä¿—è§£é‡Š**ï¼šæ­»é”å°±åƒä¸¤ä¸ªäººåœ¨çª„å··å­é‡Œç›¸é‡ï¼Œéƒ½æƒ³è®©å¯¹æ–¹å…ˆé€€è®©ï¼Œç»“æœè°éƒ½è¿‡ä¸å»ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå½¢æˆå¾ªç¯ç­‰å¾…ã€‚

**æ­»é”äº§ç”Ÿè¿‡ç¨‹**ï¼š
```
æ—¶é—´çº¿ï¼š
T1: äº‹åŠ¡Aé”å®šè¡¨1 â”€â”€â”€â”€â”€â”€â”
T2: äº‹åŠ¡Bé”å®šè¡¨2 â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
T3: äº‹åŠ¡Aè¯·æ±‚è¡¨2é” â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–¶ ç­‰å¾…Bé‡Šæ”¾
T4: äº‹åŠ¡Bè¯·æ±‚è¡¨1é” â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–¶ ç­‰å¾…Aé‡Šæ”¾
                      â”‚      â”‚
                      â–¼      â–¼
                    å½¢æˆæ­»é”ç¯è·¯
```

**è¯Šæ–­æ–¹æ³•**ï¼š
```sql
-- æŸ¥çœ‹æœ€è¿‘çš„æ­»é”ä¿¡æ¯
SHOW ENGINE INNODB STATUS\G

-- åœ¨è¾“å‡ºä¸­æŸ¥æ‰¾ "LATEST DETECTED DEADLOCK" éƒ¨åˆ†
```

**æ­»é”ä¿¡æ¯è§£è¯»**ï¼š
```
*** (1) TRANSACTION:
TRANSACTION 1234, ACTIVE 10 sec starting index read
mysql tables in use 1, locked 1
LOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 15, OS thread handle 123456789, query id 567 localhost root updating
UPDATE users SET name='Alice' WHERE id=1

*** (2) TRANSACTION:
TRANSACTION 1235, ACTIVE 8 sec starting index read
mysql tables in use 1, locked 1
3 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 16, OS thread handle 987654321, query id 568 localhost root updating
UPDATE users SET email='alice@example.com' WHERE id=2
```

**é¢„é˜²æ­»é”ç­–ç•¥**ï¼š
- **ç»Ÿä¸€åŠ é”é¡ºåº**ï¼šæ‰€æœ‰äº‹åŠ¡æŒ‰ç›¸åŒé¡ºåºè®¿é—®è¡¨
- **ç¼©çŸ­äº‹åŠ¡æ—¶é—´**ï¼šå‡å°‘é”æŒæœ‰æ—¶é—´
- **ä½¿ç”¨è¾ƒä½éš”ç¦»çº§åˆ«**ï¼šå¦‚READ COMMITTED
- **æ·»åŠ ç´¢å¼•**ï¼šå‡å°‘é”å®šèŒƒå›´

---

## 3. ğŸ”„ ä¸»ä»åŒæ­¥æ•…éšœ



### 3.1 ä¸»ä»å»¶è¿Ÿå¤„ç†æ–¹æ³•



**é€šä¿—è§£é‡Š**ï¼šä¸»ä»åŒæ­¥å°±åƒè€å¸ˆè®²è¯¾å’Œå­¦ç”Ÿè®°ç¬”è®°ï¼Œå¦‚æœå­¦ç”Ÿè®°å½•é€Ÿåº¦è·Ÿä¸ä¸Šè€å¸ˆè®²è¯¾é€Ÿåº¦ï¼Œå°±ä¼šäº§ç”Ÿå»¶è¿Ÿã€‚

**å»¶è¿Ÿè¯Šæ–­**ï¼š
```sql
-- åœ¨ä»åº“æ‰§è¡Œï¼ŒæŸ¥çœ‹å»¶è¿Ÿç§’æ•°
SHOW SLAVE STATUS\G

-- å…³æ³¨è¿™äº›å…³é”®æŒ‡æ ‡ï¼š
-- Seconds_Behind_Master: å»¶è¿Ÿç§’æ•°
-- Slave_IO_Running: IOçº¿ç¨‹çŠ¶æ€
-- Slave_SQL_Running: SQLçº¿ç¨‹çŠ¶æ€
```

**å»¶è¿ŸåŸå› åˆ†æ**ï¼š

```
ä¸»ä»åŒæ­¥æµç¨‹ï¼š
ä¸»åº“ â”€â”€[å†™å…¥]â”€â”€â–¶ binlog â”€â”€[ä¼ è¾“]â”€â”€â–¶ ä»åº“relay log â”€â”€[å›æ”¾]â”€â”€â–¶ ä»åº“æ•°æ®

å¯èƒ½çš„ç“¶é¢ˆç‚¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç½‘ç»œä¼ è¾“    â”‚   ç£ç›˜IO     â”‚   SQLå›æ”¾    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç½‘ç»œå¸¦å®½    â”‚ â€¢ ç£ç›˜æ€§èƒ½   â”‚ â€¢ å¤§äº‹åŠ¡     â”‚
â”‚ â€¢ ç½‘ç»œå»¶è¿Ÿ    â”‚ â€¢ IOç«äº‰     â”‚ â€¢ é”ç­‰å¾…     â”‚
â”‚ â€¢ æ•°æ®åŒ…ä¸¢å¤±  â”‚ â€¢ ç£ç›˜ç©ºé—´   â”‚ â€¢ å¤æ‚SQL    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```sql
-- 1. å¹¶è¡Œå¤åˆ¶ä¼˜åŒ–
SET GLOBAL slave_parallel_type = 'LOGICAL_CLOCK';
SET GLOBAL slave_parallel_workers = 4;

-- 2. è·³è¿‡é”™è¯¯ç»§ç»­åŒæ­¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
SET GLOBAL sql_slave_skip_counter = 1;
START SLAVE;

-- 3. è°ƒæ•´åŒæ­¥æ¨¡å¼
SET GLOBAL sync_binlog = 1;
SET GLOBAL innodb_flush_log_at_trx_commit = 1;
```

### 3.2 ä¸»ä»åŒæ­¥ä¸­æ–­æ•…éšœ



**æ•…éšœè¡¨ç°**ï¼š
```sql
SHOW SLAVE STATUS\G
-- Slave_IO_Running: No
-- Slave_SQL_Running: No
-- Last_Error: ...
```

**å¸¸è§é”™è¯¯ç±»å‹**ï¼š

| é”™è¯¯ç±»å‹ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|---------|---------|
| **è¿æ¥é”™è¯¯** | `Error connecting to master` | æ£€æŸ¥ç½‘ç»œã€è´¦å·æƒé™ |
| **åŒæ­¥ä½ç½®é”™è¯¯** | `Could not find first log file` | é‡æ–°è®¾ç½®åŒæ­¥ä½ç½® |
| **æ•°æ®å†²çª** | `Duplicate entry for key` | æ‰‹åŠ¨å¤„ç†å†²çªæ•°æ® |

**ä¿®å¤æ­¥éª¤**ï¼š
```sql
-- 1. åœæ­¢åŒæ­¥
STOP SLAVE;

-- 2. é‡æ–°è®¾ç½®åŒæ­¥ä½ç½®
CHANGE MASTER TO
  MASTER_HOST='ä¸»åº“IP',
  MASTER_USER='repl_user',
  MASTER_PASSWORD='å¯†ç ',
  MASTER_LOG_FILE='mysql-bin.000001',
  MASTER_LOG_POS=154;

-- 3. å¯åŠ¨åŒæ­¥
START SLAVE;
```

---

## 4. ğŸ’¾ ç³»ç»Ÿèµ„æºé—®é¢˜



### 4.1 ç£ç›˜ç©ºé—´ä¸è¶³åº”æ€¥å¤„ç†



**æ•…éšœç°è±¡**ï¼š
```
ERROR 1114 (HY000): The table 'tablename' is full
ERROR 3 (HY000): Error writing file '/tmp/xxx' (Errcode: 28 - No space left on device)
```

**é€šä¿—è§£é‡Š**ï¼šå°±åƒæ‰‹æœºå­˜å‚¨ç©ºé—´æ»¡äº†æ— æ³•æ‹ç…§ä¸€æ ·ï¼ŒMySQLæ— æ³•å†™å…¥æ–°æ•°æ®æˆ–åˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚

**åº”æ€¥å¤„ç†æµç¨‹**ï¼š

```
ç´§æ€¥å¤„ç†æ­¥éª¤ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è¯„ä¼°ä¸¥é‡ç¨‹åº¦  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ¸…ç†ä¸´æ—¶æ–‡ä»¶  â”‚ â”€â”€ /tmp/ä¸‹çš„MySQLä¸´æ—¶æ–‡ä»¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ¸…ç†æ—¥å¿—æ–‡ä»¶  â”‚ â”€â”€ binlogã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ç§»åŠ¨æ•°æ®æ–‡ä»¶  â”‚ â”€â”€ æ•°æ®æ–‡ä»¶è¿ç§»åˆ°å…¶ä»–åˆ†åŒº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…·ä½“æ“ä½œ**ï¼š
```bash
# 1. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ

df -h
du -sh /var/lib/mysql/*

# 2. æ¸…ç†binlogï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰

PURGE BINARY LOGS BEFORE DATE_SUB(NOW(), INTERVAL 7 DAY);

# 3. æ¸…ç†æ…¢æŸ¥è¯¢æ—¥å¿—

> /var/log/mysql/mysql-slow.log

# 4. ä¸´æ—¶æ‰©å®¹ï¼ˆè½¯é“¾æ¥æ–¹å¼ï¼‰

mkdir /data/mysql_temp
ln -s /data/mysql_temp /var/lib/mysql/temp_tablespace
```

### 4.2 å†…å­˜æº¢å‡ºé—®é¢˜



**æ•…éšœç°è±¡**ï¼š
- MySQLè¿›ç¨‹è¢«ç³»ç»ŸOOM Killeræ€æ­»
- è¿æ¥å“åº”ææ…¢
- æœåŠ¡å™¨æ•´ä½“æ€§èƒ½ä¸‹é™

**å†…å­˜ä½¿ç”¨åˆ†æ**ï¼š
```
MySQLå†…å­˜ä½¿ç”¨ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å…¨å±€å†…å­˜åŒºåŸŸ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ innodb_buffer_pool_size (æœ€å¤§)    â”‚
â”‚ â€¢ key_buffer_size (MyISAM)          â”‚
â”‚ â€¢ query_cache_size                  â”‚
â”‚ â€¢ table_open_cache                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  +
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ¯è¿æ¥å†…å­˜ Ã— è¿æ¥æ•°           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ sort_buffer_size                  â”‚
â”‚ â€¢ read_buffer_size                  â”‚
â”‚ â€¢ join_buffer_size                  â”‚
â”‚ â€¢ thread_stack                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŒ–é…ç½®**ï¼š
```sql
-- æŸ¥çœ‹å†…å­˜ç›¸å…³é…ç½®
SHOW VARIABLES LIKE '%buffer%';
SHOW VARIABLES LIKE '%cache%';

-- ä¼˜åŒ–å»ºè®®ï¼ˆ8GBå†…å­˜æœåŠ¡å™¨ï¼‰
SET GLOBAL innodb_buffer_pool_size = 5368709120;  -- 5GB
SET GLOBAL query_cache_size = 134217728;          -- 128MB
SET GLOBAL sort_buffer_size = 2097152;            -- 2MB
```

---

## 5. ğŸ”§ æ•°æ®æŸåæ¢å¤



### 5.1 InnoDBå´©æºƒæ¢å¤



**æ•…éšœç°è±¡**ï¼š
```
InnoDB: Database page corruption on disk or a failed
InnoDB: file read of page 5
InnoDB: You may have to recover from a backup.
```

**é€šä¿—è§£é‡Š**ï¼šæ•°æ®æ–‡ä»¶æŸåå°±åƒä¹¦çš„æŸäº›é¡µé¢è¢«æ’•ç ´æˆ–å­—è¿¹æ¨¡ç³Šï¼ŒMySQLéœ€è¦é€šè¿‡äº‹åŠ¡æ—¥å¿—æ¥ä¿®å¤è¿™äº›æŸåã€‚

**InnoDBæ¢å¤æœºåˆ¶**ï¼š
```
æ¢å¤è¿‡ç¨‹ï¼š
å¯åŠ¨MySQL
    â”‚
    â–¼
è¯»å–redo log â”€â”€â”€â”€â”€â”€â”
    â”‚              â”‚
    â–¼              â–¼
åº”ç”¨å·²æäº¤äº‹åŠ¡    å›æ»šæœªæäº¤äº‹åŠ¡
    â”‚              â”‚
    â–¼              â–¼
æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ â”€â”€â”€â”€â”˜
    â”‚
    â–¼
å¯åŠ¨å®Œæˆ
```

**æ¢å¤æ“ä½œ**ï¼š
```bash
# 1. å¼ºåˆ¶æ¢å¤æ¨¡å¼å¯åŠ¨

[mysqld]
innodb_force_recovery = 1

# 2. å¯¼å‡ºæ•°æ®

mysqldump --all-databases > backup.sql

# 3. é‡æ–°åˆå§‹åŒ–

rm -rf /var/lib/mysql/ib*
mysqld --initialize

# 4. æ¢å¤æ•°æ®

mysql < backup.sql
```

**æ¢å¤çº§åˆ«è¯´æ˜**ï¼š
- **Level 1**ï¼šå¿½ç•¥æŸåé¡µé¢
- **Level 2**ï¼šé˜»æ­¢ä¸»çº¿ç¨‹è¿è¡Œ
- **Level 3**ï¼šä¸æ‰§è¡Œäº‹åŠ¡å›æ»š
- **Level 4**ï¼šä¸æ‰§è¡Œæ’å…¥ç¼“å†²åˆå¹¶
- **Level 5**ï¼šä¸æŸ¥çœ‹æ’¤é”€æ—¥å¿—
- **Level 6**ï¼šä¸æ‰§è¡Œå‰æ»š

---

## 6. âš™ï¸ é…ç½®ç›¸å…³é”™è¯¯



### 6.1 å­—ç¬¦é›†è½¬æ¢é”™è¯¯



**æ•…éšœç°è±¡**ï¼š
```
ERROR 1366 (HY000): Incorrect string value: '\xF0\x9F\x98\x80' for column 'content'
```

**é€šä¿—è§£é‡Š**ï¼šå°±åƒç”¨é”™è¯¯çš„å­—å…¸ç¿»è¯‘å¤–è¯­ä¸€æ ·ï¼Œæ•°æ®åº“ä½¿ç”¨äº†ä¸åŒ¹é…çš„å­—ç¬¦é›†æ¥è§£é‡Šæ•°æ®ã€‚

**å­—ç¬¦é›†å±‚æ¬¡ç»“æ„**ï¼š
```
å­—ç¬¦é›†è®¾ç½®å±‚æ¬¡ï¼š
æœåŠ¡å™¨çº§åˆ« (character_set_server)
    â”‚
    â–¼
æ•°æ®åº“çº§åˆ« (DEFAULT CHARACTER SET)
    â”‚
    â–¼
è¡¨çº§åˆ« (CHARACTER SET)
    â”‚
    â–¼
å­—æ®µçº§åˆ« (CHARACTER SET)
```

**æ£€æŸ¥ä¸ä¿®å¤**ï¼š
```sql
-- æ£€æŸ¥å­—ç¬¦é›†è®¾ç½®
SHOW VARIABLES LIKE 'character_set%';
SHOW VARIABLES LIKE 'collation%';

-- ä¿®æ”¹å­—ç¬¦é›†
ALTER DATABASE dbname CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE tablename CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 6.2 é…ç½®å‚æ•°é”™è¯¯



**å¸¸è§é…ç½®é”™è¯¯**ï¼š

| å‚æ•° | é”™è¯¯è®¾ç½® | æ­£ç¡®è®¾ç½® | å½±å“ |
|------|---------|---------|------|
| `innodb_buffer_pool_size` | è¶…è¿‡ç‰©ç†å†…å­˜80% | ç‰©ç†å†…å­˜çš„70-80% | å†…å­˜æº¢å‡º |
| `max_connections` | è®¾ç½®è¿‡å¤§ | æ ¹æ®å®é™…éœ€æ±‚è®¾ç½® | å†…å­˜æµªè´¹ |
| `innodb_log_file_size` | è®¾ç½®è¿‡å° | è‡³å°‘256MB | é¢‘ç¹åˆ·ç›˜ |

---

## 7. ğŸ“Š æ€§èƒ½é—®é¢˜è¯Šæ–­



### 7.1 æ…¢æŸ¥è¯¢æ•…éšœ



**è¯Šæ–­æ–¹æ³•**ï¼š
```sql
-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2;
SET GLOBAL log_queries_not_using_indexes = 'ON';

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢ç»Ÿè®¡
SHOW STATUS LIKE 'Slow_queries';
```

**æ…¢æŸ¥è¯¢åˆ†æå·¥å…·**ï¼š
```bash
# ä½¿ç”¨mysqldumpslowåˆ†æ

mysqldumpslow -s c -t 10 /var/log/mysql/mysql-slow.log

# ä½¿ç”¨pt-query-digest

pt-query-digest /var/log/mysql/mysql-slow.log
```

---

## 8. ğŸ” æ•…éšœæ’æŸ¥æ–¹æ³•è®º



### 8.1 åŸºç¡€æ•…éšœæ¢å¤æ–¹æ³•



**æ•…éšœæ’æŸ¥äº”æ­¥æ³•**ï¼š

```
æ’æŸ¥æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç°è±¡ç¡®è®¤  â”‚ â”€â”€ æ”¶é›†é”™è¯¯ä¿¡æ¯ã€æ—¥å¿—
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. èŒƒå›´å®šä½  â”‚ â”€â”€ ç¡®å®šæ˜¯ç½‘ç»œã€ç³»ç»Ÿè¿˜æ˜¯MySQLé—®é¢˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. åŸå› åˆ†æ  â”‚ â”€â”€ æŸ¥çœ‹ç›‘æ§æ•°æ®ã€é…ç½®æ–‡ä»¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. è§£å†³æ–¹æ¡ˆ  â”‚ â”€â”€ åˆ¶å®šå¹¶å®æ–½è§£å†³è®¡åˆ’
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. éªŒè¯æ€»ç»“  â”‚ â”€â”€ éªŒè¯ä¿®å¤æ•ˆæœã€è®°å½•ç»éªŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 å¸¸è§é”™è¯¯ä¿¡æ¯è§£è¯»



**é‡è¦é”™è¯¯ä»£ç **ï¼š

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¸¸è§åŸå›  | è§£å†³æ–¹å‘ |
|--------|---------|---------|---------|
| **1040** | Too many connections | è¿æ¥æ•°è¶…é™ | è°ƒæ•´max_connections |
| **1205** | Lock wait timeout | é”ç­‰å¾…è¶…æ—¶ | æ£€æŸ¥é•¿äº‹åŠ¡ |
| **2003** | Can't connect to MySQL | è¿æ¥å¤±è´¥ | æ£€æŸ¥æœåŠ¡ã€ç½‘ç»œ |
| **1114** | Table is full | ç£ç›˜ç©ºé—´ä¸è¶³ | æ¸…ç†ç©ºé—´ |

### 8.3 æ•…éšœé¢„é˜²ç­–ç•¥



**ç›‘æ§å…³é”®æŒ‡æ ‡**ï¼š
- **è¿æ¥æ•°**ï¼šThreads_connected / max_connections
- **é”ç­‰å¾…**ï¼šInnodb_row_lock_waits
- **æ…¢æŸ¥è¯¢**ï¼šSlow_queries
- **å¤åˆ¶å»¶è¿Ÿ**ï¼šSeconds_Behind_Master
- **ç£ç›˜ç©ºé—´**ï¼šç£ç›˜ä½¿ç”¨ç‡
- **å†…å­˜ä½¿ç”¨**ï¼šBuffer Poolä½¿ç”¨ç‡

**æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡**ï¼š
```bash
# å®šæœŸæ£€æŸ¥è„šæœ¬ç¤ºä¾‹

#!/bin/bash

# MySQLå¥åº·æ£€æŸ¥è„šæœ¬


# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

systemctl is-active mysqld

# 2. æ£€æŸ¥è¿æ¥æ•°

mysql -e "SHOW STATUS LIKE 'Threads_connected'"

# 3. æ£€æŸ¥å¤åˆ¶çŠ¶æ€

mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master"

# 4. æ£€æŸ¥ç£ç›˜ç©ºé—´

df -h | grep mysql

# 5. æ£€æŸ¥é”™è¯¯æ—¥å¿—

tail -n 100 /var/log/mysql/error.log | grep ERROR
```

---

# ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## ğŸ”‘ å…³é”®çŸ¥è¯†ç‚¹



```
æ•…éšœå¤„ç†æ ¸å¿ƒåŸåˆ™ï¼š
ğŸ”¸ å¿«é€Ÿå®šä½ï¼šä»ç°è±¡å…¥æ‰‹ï¼Œé€æ­¥ç¼©å°èŒƒå›´
ğŸ”¸ å®‰å…¨ç¬¬ä¸€ï¼šå¤‡ä»½æ•°æ®ï¼Œè°¨æ…æ“ä½œ
ğŸ”¸ æ ‡æœ¬å…¼æ²»ï¼šæ—¢è¦å¿«é€Ÿæ¢å¤ï¼Œä¹Ÿè¦æ‰¾å‡ºæ ¹å› 
ğŸ”¸ é¢„é˜²ä¸ºä¸»ï¼šå»ºç«‹ç›‘æ§ï¼Œå®šæœŸæ£€æŸ¥
ğŸ”¸ æ–‡æ¡£è®°å½•ï¼šè®°å½•æ•…éšœè¿‡ç¨‹ï¼Œç§¯ç´¯ç»éªŒ
```

## ğŸ¯ å®æˆ˜æŠ€èƒ½



**å¿…å¤‡è¯Šæ–­å‘½ä»¤**ï¼š
- `SHOW PROCESSLIST` - æŸ¥çœ‹å½“å‰è¿æ¥
- `SHOW ENGINE INNODB STATUS` - æŸ¥çœ‹InnoDBçŠ¶æ€
- `SHOW SLAVE STATUS` - æŸ¥çœ‹å¤åˆ¶çŠ¶æ€
- `SHOW VARIABLES` - æŸ¥çœ‹é…ç½®å‚æ•°
- `SHOW STATUS` - æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

**æ•…éšœå¤„ç†æ€è·¯**ï¼š
1. **æ”¶é›†ä¿¡æ¯** - é”™è¯¯æ—¥å¿—ã€ç›‘æ§æ•°æ®ã€ç”¨æˆ·åé¦ˆ
2. **å¿«é€Ÿæ¢å¤** - ä¼˜å…ˆæ¢å¤æœåŠ¡å¯ç”¨æ€§
3. **æ·±å…¥åˆ†æ** - æ‰¾å‡ºæ•…éšœæ ¹æœ¬åŸå› 
4. **é¢„é˜²æ”¹è¿›** - ä¼˜åŒ–é…ç½®ã€å®Œå–„ç›‘æ§

## âš¡ åº”æ€¥å¤„ç†è¦ç‚¹



**ç´§æ€¥æƒ…å†µä¼˜å…ˆçº§**ï¼š
1. **æ•°æ®å®‰å…¨** - é˜²æ­¢æ•°æ®ä¸¢å¤±æˆ–æŸå
2. **æœåŠ¡æ¢å¤** - å¿«é€Ÿæ¢å¤ä¸šåŠ¡å¯ç”¨æ€§  
3. **æ€§èƒ½ä¼˜åŒ–** - æå‡ç³»ç»Ÿç¨³å®šæ€§
4. **ç›‘æ§å®Œå–„** - é¢„é˜²ç±»ä¼¼é—®é¢˜å†æ¬¡å‘ç”Ÿ

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ•…éšœå¤„ç†è¦å†·é™åˆ†æï¼ŒæŒ‰æ­¥éª¤æ’æŸ¥
- å¤‡ä»½å’Œç›‘æ§æ˜¯è¿ç»´çš„ç”Ÿå‘½çº¿
- ç»éªŒç§¯ç´¯æ¯”æŠ€æœ¯æŠ€å·§æ›´é‡è¦
- é¢„é˜²èƒœè¿‡æ²»ç–—ï¼Œç›‘æ§å…ˆäºæ•…éšœ