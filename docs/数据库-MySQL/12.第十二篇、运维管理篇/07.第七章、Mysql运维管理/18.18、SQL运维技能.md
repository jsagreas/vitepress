---
title: 18ã€SQLè¿ç»´æŠ€èƒ½
---
## ğŸ“š ç›®å½•

1. [æ…¢æŸ¥è¯¢è¿ç»´åˆ†ææŠ€èƒ½](#1-æ…¢æŸ¥è¯¢è¿ç»´åˆ†ææŠ€èƒ½)
2. [æ‰§è¡Œè®¡åˆ’è¿ç»´è§£è¯»](#2-æ‰§è¡Œè®¡åˆ’è¿ç»´è§£è¯»)
3. [ç´¢å¼•è¿ç»´ä¼˜åŒ–æŠ€èƒ½](#3-ç´¢å¼•è¿ç»´ä¼˜åŒ–æŠ€èƒ½)
4. [æŸ¥è¯¢é‡å†™è¿ç»´æŠ€æœ¯](#4-æŸ¥è¯¢é‡å†™è¿ç»´æŠ€æœ¯)
5. [SQLå®¡æ ¸è¿ç»´æµç¨‹](#5-SQLå®¡æ ¸è¿ç»´æµç¨‹)
6. [æŸ¥è¯¢æ€§èƒ½åŸºçº¿ç®¡ç†](#6-æŸ¥è¯¢æ€§èƒ½åŸºçº¿ç®¡ç†)
7. [SQLå˜æ›´å½±å“è¯„ä¼°](#7-SQLå˜æ›´å½±å“è¯„ä¼°)
8. [Query Cacheè¿ç»´ç­–ç•¥](#8-Query-Cacheè¿ç»´ç­–ç•¥)
9. [æŸ¥è¯¢ä¼˜åŒ–å™¨è¿ç»´è°ƒä¼˜](#9-æŸ¥è¯¢ä¼˜åŒ–å™¨è¿ç»´è°ƒä¼˜)
10. [SQLæ‰§è¡Œç»Ÿè®¡åˆ†æ](#10-SQLæ‰§è¡Œç»Ÿè®¡åˆ†æ)
11. [æŸ¥è¯¢æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ](#11-æŸ¥è¯¢æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ æ…¢æŸ¥è¯¢è¿ç»´åˆ†ææŠ€èƒ½


### 1.1 ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢


**ç®€å•ç†è§£**ï¼šæ…¢æŸ¥è¯¢å°±åƒæ˜¯æ’é˜Ÿä¹°ç¥¨æ—¶é‚£ä¸ªç‰¹åˆ«æ…¢çš„çª—å£ï¼Œè®©æ•´ä¸ªé˜Ÿä¼éƒ½å˜æ…¢äº†ã€‚

```
æ­£å¸¸æŸ¥è¯¢ï¼šå®¢æˆ·æ¥äº†ï¼Œç«‹é©¬å°±èƒ½å¾—åˆ°ç»“æœ â† 1ç§’å†…
æ…¢æŸ¥è¯¢ï¼šå®¢æˆ·æ¥äº†ï¼Œç­‰äº†å¥½ä¹…æ‰æœ‰ç»“æœ   â† è¶…è¿‡è®¾å®šé˜ˆå€¼(æ¯”å¦‚2ç§’)
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **æ…¢æŸ¥è¯¢æ—¥å¿—**ï¼šMySQLè‡ªåŠ¨è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„SQLè¯­å¥
- **long_query_time**ï¼šåˆ¤æ–­æ…¢æŸ¥è¯¢çš„æ—¶é—´é˜ˆå€¼ï¼Œé»˜è®¤10ç§’
- **slow_query_log**ï¼šæ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•

### 1.2 æ…¢æŸ¥è¯¢é…ç½®ä¸å¼€å¯


**å¼€å¯æ…¢æŸ¥è¯¢ç›‘æ§**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰é…ç½®
SHOW VARIABLES LIKE '%slow%';
SHOW VARIABLES LIKE 'long_query_time';

-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
-- è®¾ç½®æ…¢æŸ¥è¯¢é˜ˆå€¼ä¸º2ç§’
SET GLOBAL long_query_time = 2;
-- è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SET GLOBAL log_queries_not_using_indexes = 'ON';
```

**æ°¸ä¹…é…ç½®**ï¼ˆä¿®æ”¹my.cnfï¼‰ï¼š
```ini
[mysqld]
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1
min_examined_row_limit = 100
```

### 1.3 æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ


**æ—¥å¿—å†…å®¹è§£è¯»**ï¼š
```
# Time: 2025-09-09T15:30:45.123456Z
# User@Host: webapp[webapp] @ [192.168.1.100]
# Thread_id: 12345  Schema: ecommerce  QC_hit: No
# Query_time: 5.234567  Lock_time: 0.000123  Rows_sent: 1  Rows_examined: 1000000
# Rows_affected: 0
SET timestamp=1694268645;
SELECT * FROM orders WHERE create_time > '2025-01-01' AND status = 'pending';
```

**å…³é”®æŒ‡æ ‡å«ä¹‰**ï¼š
- **Query_time**ï¼šSQLæ‰§è¡Œæ€»æ—¶é—´
- **Lock_time**ï¼šç­‰å¾…é”çš„æ—¶é—´
- **Rows_sent**ï¼šè¿”å›ç»™å®¢æˆ·ç«¯çš„è¡Œæ•°
- **Rows_examined**ï¼šæ‰«æçš„è¡Œæ•°

### 1.4 æ…¢æŸ¥è¯¢åˆ†æå·¥å…·


**mysqldumpslowå·¥å…·ä½¿ç”¨**ï¼š
```bash
# åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—
mysqldumpslow -s t -t 10 /var/log/mysql/slow.log

# å‚æ•°è¯´æ˜ï¼š
# -s t : æŒ‰æŸ¥è¯¢æ—¶é—´æ’åº
# -s c : æŒ‰æŸ¥è¯¢æ¬¡æ•°æ’åº
# -s r : æŒ‰è¿”å›è¡Œæ•°æ’åº
# -t 10: æ˜¾ç¤ºå‰10æ¡
# -g pattern: åŒ…å«æŒ‡å®šæ¨¡å¼çš„æŸ¥è¯¢
```

**è¾“å‡ºç»“æœè§£è¯»**ï¼š
```
Count: 156  Time=4.23s (661s)  Lock=0.01s (1s)  Rows=1.0 (156), webapp[webapp]@[%]
SELECT * FROM orders WHERE create_time > 'S' AND status = 'S'

è§£é‡Šï¼š
- Count: å‡ºç°156æ¬¡
- Time=4.23s: å¹³å‡æ‰§è¡Œæ—¶é—´4.23ç§’
- (661s): æ€»æ‰§è¡Œæ—¶é—´661ç§’
- Lock=0.01s: å¹³å‡é”ç­‰å¾…æ—¶é—´
- Rows=1.0: å¹³å‡è¿”å›1è¡Œ
```

### 1.5 æ…¢æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥


**åˆ†ææ€è·¯**ï¼š
```
æ­¥éª¤1ï¼šè¯†åˆ«æ…¢æŸ¥è¯¢ â†’ æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—
æ­¥éª¤2ï¼šåˆ†æåŸå›  â†’ æ‰§è¡Œè®¡åˆ’åˆ†æ
æ­¥éª¤3ï¼šåˆ¶å®šæ–¹æ¡ˆ â†’ ç´¢å¼•ä¼˜åŒ–/SQLé‡å†™
æ­¥éª¤4ï¼šéªŒè¯æ•ˆæœ â†’ æ€§èƒ½å¯¹æ¯”æµ‹è¯•
æ­¥éª¤5ï¼šæŒç»­ç›‘æ§ â†’ å®šæœŸæ£€æŸ¥æ—¥å¿—
```

**å¸¸è§ä¼˜åŒ–æ–¹å‘**ï¼š
- **æ·»åŠ ç´¢å¼•**ï¼šä¸ºWHEREã€ORDER BYã€JOINå­—æ®µåˆ›å»ºåˆé€‚ç´¢å¼•
- **SQLé‡å†™**ï¼šä¼˜åŒ–SQLè¯­å¥ç»“æ„
- **åˆ†é¡µä¼˜åŒ–**ï¼šé¿å…å¤§åç§»é‡çš„LIMITæŸ¥è¯¢
- **æ•°æ®å½’æ¡£**ï¼šæ¸…ç†å†å²æ•°æ®ï¼Œå‡å°‘è¡¨å¤§å°

---

## 2. ğŸ“Š æ‰§è¡Œè®¡åˆ’è¿ç»´è§£è¯»


### 2.1 æ‰§è¡Œè®¡åˆ’åŸºç¡€æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ‰§è¡Œè®¡åˆ’**ï¼š
å°±åƒGPSå¯¼èˆªä¼šå‘Šè¯‰ä½ èµ°å“ªæ¡è·¯æœ€å¿«ä¸€æ ·ï¼Œæ‰§è¡Œè®¡åˆ’å‘Šè¯‰æˆ‘ä»¬MySQLä¼šå¦‚ä½•æ‰§è¡Œä¸€æ¡SQLè¯­å¥ã€‚

```
ä½ çš„è¯·æ±‚ï¼šæˆ‘è¦ä»Aç‚¹åˆ°Bç‚¹
GPSåˆ†æï¼šåˆ†ææ‰€æœ‰å¯èƒ½è·¯å¾„ï¼Œé€‰æ‹©æœ€ä¼˜è·¯çº¿
MySQLåˆ†æï¼šåˆ†ææ‰€æœ‰å¯èƒ½çš„æŸ¥è¯¢æ–¹å¼ï¼Œé€‰æ‹©æˆæœ¬æœ€ä½çš„æ‰§è¡Œè®¡åˆ’
```

### 2.2 EXPLAINå‘½ä»¤è¯¦è§£


**åŸºæœ¬ç”¨æ³•**ï¼š
```sql
-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM orders o 
JOIN customers c ON o.customer_id = c.id 
WHERE o.create_time > '2025-01-01';

-- è¯¦ç»†æ ¼å¼
EXPLAIN FORMAT=JSON SELECT ...;
```

**è¾“å‡ºç»“æœç¤ºä¾‹**ï¼š
```
+----+-------------+-------+------+---------------+---------+---------+-------+------+-------------+
| id | select_type | table | type | possible_keys | key     | key_len | ref   | rows | Extra       |
+----+-------------+-------+------+---------------+---------+---------+-------+------+-------------+
|  1 | SIMPLE      | o     | range| idx_time      | idx_time|    8    | NULL  | 1000 | Using where |
|  1 | SIMPLE      | c     | eq_ref| PRIMARY      | PRIMARY |    4    | o.id  |    1 | NULL        |
+----+-------------+-------+------+---------------+---------+---------+-------+------+-------------+
```

### 2.3 æ‰§è¡Œè®¡åˆ’å…³é”®å­—æ®µè§£è¯»


#### ğŸ” typeå­—æ®µï¼ˆè®¿é—®ç±»å‹ï¼‰


**æ€§èƒ½ä»å¥½åˆ°å·®æ’åº**ï¼š
```
system > const > eq_ref > ref > range > index > ALL

æ€§èƒ½ç­‰çº§è¯´æ˜ï¼š
ğŸŸ¢ system/const  ï¼š æœ€ä¼˜ï¼Œå¸¸é‡æŸ¥è¯¢
ğŸŸ¢ eq_ref        ï¼š å¾ˆå¥½ï¼Œå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢  
ğŸŸ¡ ref           ï¼š è‰¯å¥½ï¼Œéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢
ğŸŸ¡ range         ï¼š ä¸€èˆ¬ï¼ŒèŒƒå›´æŸ¥è¯¢
ğŸ”´ index         ï¼š è¾ƒå·®ï¼Œç´¢å¼•å…¨æ‰«æ
ğŸ”´ ALL           ï¼š æœ€å·®ï¼Œå…¨è¡¨æ‰«æ
```

**å®é™…ä¾‹å­**ï¼š
```sql
-- constç±»å‹ï¼šä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢
EXPLAIN SELECT * FROM users WHERE id = 1;

-- refç±»å‹ï¼šæ™®é€šç´¢å¼•ç­‰å€¼æŸ¥è¯¢  
EXPLAIN SELECT * FROM orders WHERE customer_id = 100;

-- rangeç±»å‹ï¼šèŒƒå›´æŸ¥è¯¢
EXPLAIN SELECT * FROM orders WHERE create_time > '2025-01-01';

-- ALLç±»å‹ï¼šå…¨è¡¨æ‰«æï¼ˆéœ€è¦ä¼˜åŒ–ï¼‰
EXPLAIN SELECT * FROM orders WHERE description LIKE '%keyword%';
```

#### ğŸ“‹ keyå­—æ®µï¼ˆä½¿ç”¨çš„ç´¢å¼•ï¼‰


```
key = NULL     ï¼š æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæ€§èƒ½å·®
key = PRIMARY  ï¼š ä½¿ç”¨ä¸»é”®ç´¢å¼•
key = idx_name ï¼š ä½¿ç”¨æŒ‡å®šç´¢å¼•
```

#### ğŸ“Š rowså­—æ®µï¼ˆé¢„ä¼°æ‰«æè¡Œæ•°ï¼‰


```
rows = 1      ï¼š æœ€ç†æƒ³ï¼Œæ‰«æ1è¡Œ
rows = 100    ï¼š è¿˜å¯ä»¥ï¼Œæ‰«æ100è¡Œ  
rows = 10000  ï¼š éœ€è¦å…³æ³¨ï¼Œæ‰«æ1ä¸‡è¡Œ
rows = 100ä¸‡+ ï¼š éœ€è¦ä¼˜åŒ–ï¼Œæ‰«æè¿‡å¤š
```

### 2.4 Extraå­—æ®µé‡è¦ä¿¡æ¯


**å¸¸è§Extraä¿¡æ¯è§£è¯»**ï¼š

| Extraä¿¡æ¯ | å«ä¹‰ | æ€§èƒ½å½±å“ | ä¼˜åŒ–å»ºè®® |
|-----------|------|----------|----------|
| `Using index` | ğŸŸ¢ ä»…ä½¿ç”¨ç´¢å¼•ï¼Œæ— éœ€å›è¡¨ | å¾ˆå¥½ | ä¿æŒç°çŠ¶ |
| `Using where` | ğŸŸ¡ ä½¿ç”¨WHEREè¿‡æ»¤ | ä¸€èˆ¬ | è€ƒè™‘ä¼˜åŒ–WHEREæ¡ä»¶ |
| `Using filesort` | ğŸ”´ éœ€è¦é¢å¤–æ’åº | è¾ƒå·® | ä¸ºORDER BYå­—æ®µåŠ ç´¢å¼• |
| `Using temporary` | ğŸ”´ ä½¿ç”¨ä¸´æ—¶è¡¨ | è¾ƒå·® | ä¼˜åŒ–GROUP BYæˆ–DISTINCT |
| `Using index condition` | ğŸŸ¡ ç´¢å¼•ä¸‹æ¨ | å¥½ | MySQLè‡ªåŠ¨ä¼˜åŒ– |

### 2.5 æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–å®ä¾‹


**æ¡ˆä¾‹1ï¼šORDER BYä¼˜åŒ–**
```sql
-- é—®é¢˜SQLï¼šäº§ç”ŸUsing filesort
EXPLAIN SELECT * FROM orders 
WHERE customer_id = 100 
ORDER BY create_time DESC 
LIMIT 10;

-- è§£å†³æ–¹æ¡ˆï¼šåˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX idx_customer_time ON orders(customer_id, create_time);

-- ä¼˜åŒ–åï¼šExtraä¸­ä¸å†æœ‰Using filesort
```

**æ¡ˆä¾‹2ï¼šJOINæŸ¥è¯¢ä¼˜åŒ–**
```sql
-- é—®é¢˜SQLï¼šJOINå­—æ®µæ²¡æœ‰ç´¢å¼•
EXPLAIN SELECT o.*, c.name 
FROM orders o 
JOIN customers c ON o.customer_id = c.id;

-- è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿JOINå­—æ®µæœ‰ç´¢å¼•
CREATE INDEX idx_customer_id ON orders(customer_id);
-- customersè¡¨çš„idå­—æ®µé€šå¸¸å·²ç»æ˜¯ä¸»é”®ç´¢å¼•
```

---

## 3. ğŸ”§ ç´¢å¼•è¿ç»´ä¼˜åŒ–æŠ€èƒ½


### 3.1 ç´¢å¼•åŸºç¡€æ¦‚å¿µ


**ç´¢å¼•æ˜¯ä»€ä¹ˆ**ï¼š
ç´¢å¼•å°±åƒä¹¦çš„ç›®å½•ï¼Œå¸®ä½ å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„å†…å®¹ï¼Œè€Œä¸ç”¨ä¸€é¡µé¡µç¿»æ‰¾ã€‚

```
æ²¡æœ‰ç´¢å¼•ï¼šæƒ³æ‰¾"ç¬¬5ç« "å†…å®¹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç¬¬1ç«      â”‚ â† ç¿»é¡µæŸ¥çœ‹
â”‚ç¬¬2ç«      â”‚ â† ç¿»é¡µæŸ¥çœ‹  
â”‚ç¬¬3ç«      â”‚ â† ç¿»é¡µæŸ¥çœ‹
â”‚ç¬¬4ç«      â”‚ â† ç¿»é¡µæŸ¥çœ‹
â”‚ç¬¬5ç«  âœ“   â”‚ â† æ‰¾åˆ°äº†ï¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœ‰ç´¢å¼•ï¼šæŸ¥çœ‹ç›®å½•ç›´æ¥è·³è½¬
ç›®å½•ï¼šç¬¬5ç« ...ç¬¬50é¡µ â†’ ç›´æ¥ç¿»åˆ°ç¬¬50é¡µ âœ“
```

### 3.2 ç´¢å¼•ç±»å‹å’Œé€‰æ‹©


**ä¸»è¦ç´¢å¼•ç±»å‹**ï¼š

```
B+Treeç´¢å¼•ï¼ˆé»˜è®¤ï¼‰ï¼š
- é€‚ç”¨åœºæ™¯ï¼šç­‰å€¼æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢ã€æ’åº
- ç¤ºä¾‹ï¼šWHERE id = 1, WHERE age > 18, ORDER BY name

å“ˆå¸Œç´¢å¼•ï¼š
- é€‚ç”¨åœºæ™¯ï¼šç­‰å€¼æŸ¥è¯¢
- é™åˆ¶ï¼šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åº
- ç¤ºä¾‹ï¼šWHERE status = 'active'

å…¨æ–‡ç´¢å¼•ï¼š
- é€‚ç”¨åœºæ™¯ï¼šæ–‡æœ¬æœç´¢
- ç¤ºä¾‹ï¼šWHERE MATCH(content) AGAINST('keyword')
```

### 3.3 ç´¢å¼•åˆ›å»ºç­–ç•¥


**å•åˆ—ç´¢å¼•åˆ›å»º**ï¼š
```sql
-- ä¸ºç»å¸¸æŸ¥è¯¢çš„å­—æ®µåˆ›å»ºç´¢å¼•
CREATE INDEX idx_customer_id ON orders(customer_id);
CREATE INDEX idx_status ON orders(status);
CREATE INDEX idx_create_time ON orders(create_time);
```

**å¤åˆç´¢å¼•åˆ›å»º**ï¼š
```sql
-- å¤åˆç´¢å¼•éµå¾ª"æœ€å·¦å‰ç¼€"åŸåˆ™
CREATE INDEX idx_customer_status_time ON orders(customer_id, status, create_time);

-- å¯ä»¥è¦†ç›–çš„æŸ¥è¯¢ï¼š
-- âœ“ WHERE customer_id = 1
-- âœ“ WHERE customer_id = 1 AND status = 'paid'  
-- âœ“ WHERE customer_id = 1 AND status = 'paid' AND create_time > '2025-01-01'
-- âœ— WHERE status = 'paid' ï¼ˆè·³è¿‡äº†customer_idï¼‰
-- âœ— WHERE create_time > '2025-01-01' ï¼ˆè·³è¿‡äº†å‰é¢å­—æ®µï¼‰
```

### 3.4 ç´¢å¼•ä¼˜åŒ–æŠ€å·§


**ç´¢å¼•å­—æ®µé¡ºåºä¼˜åŒ–**ï¼š
```sql
-- é€‰æ‹©æ€§é«˜çš„å­—æ®µæ”¾å‰é¢
-- é€‰æ‹©æ€§ = ä¸åŒå€¼çš„æ•°é‡ / æ€»è¡Œæ•°

-- åˆ†æå­—æ®µé€‰æ‹©æ€§
SELECT 
  COUNT(DISTINCT customer_id) / COUNT(*) as customer_selectivity,
  COUNT(DISTINCT status) / COUNT(*) as status_selectivity
FROM orders;

-- ç»“æœï¼šcustomer_selectivity = 0.8, status_selectivity = 0.1
-- åˆ›å»ºç´¢å¼•ï¼šcustomer_idé€‰æ‹©æ€§æ›´é«˜ï¼Œæ”¾å‰é¢
CREATE INDEX idx_customer_status ON orders(customer_id, status);
```

### 3.5 ç´¢å¼•ç›‘æ§å’Œç»´æŠ¤


**æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ**ï¼š
```sql
-- æŸ¥çœ‹è¡¨çš„ç´¢å¼•ä¿¡æ¯
SHOW INDEX FROM orders;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡
SELECT 
  table_schema,
  table_name,
  index_name,
  seq_in_index,
  column_name
FROM information_schema.statistics 
WHERE table_name = 'orders';
```

**å‘ç°æœªä½¿ç”¨çš„ç´¢å¼•**ï¼š
```sql
-- 5.7+ç‰ˆæœ¬æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT 
  object_schema,
  object_name,
  index_name,
  count_read,
  count_insert,
  count_update,
  count_delete
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'your_database'
AND count_read = 0;
```

### 3.6 ç´¢å¼•ä¼˜åŒ–æ¡ˆä¾‹


**æ¡ˆä¾‹ï¼šåˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–**
```sql
-- é—®é¢˜ï¼šå¤§åç§»é‡åˆ†é¡µå¾ˆæ…¢
SELECT * FROM orders ORDER BY id LIMIT 100000, 20;

-- æ–¹æ¡ˆ1ï¼šä½¿ç”¨å­æŸ¥è¯¢
SELECT * FROM orders 
WHERE id >= (
  SELECT id FROM orders ORDER BY id LIMIT 100000, 1
) 
ORDER BY id LIMIT 20;

-- æ–¹æ¡ˆ2ï¼šè®°å½•ä¸Šæ¬¡æŸ¥è¯¢çš„æœ€å¤§ID
SELECT * FROM orders 
WHERE id > 1234567  -- ä¸Šæ¬¡æŸ¥è¯¢çš„æœ€å¤§ID
ORDER BY id LIMIT 20;
```

---

## 4. âœï¸ æŸ¥è¯¢é‡å†™è¿ç»´æŠ€æœ¯


### 4.1 æŸ¥è¯¢é‡å†™åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æŸ¥è¯¢é‡å†™**ï¼š
å°±åƒæŠŠä¸€å¥è¯ç”¨æ›´ç®€æ´ã€æ›´æ¸…æ¥šçš„æ–¹å¼é‡æ–°è¡¨è¾¾ï¼ŒæŸ¥è¯¢é‡å†™æ˜¯æŠŠSQLè¯­å¥æ”¹å†™æˆæ€§èƒ½æ›´å¥½çš„ç­‰ä»·å½¢å¼ã€‚

```
åŸæ¥çš„è¯ï¼š"æˆ‘æƒ³è¦ä¹°ä¸€äº›åœ¨æ‰“æŠ˜å¹¶ä¸”è¯„ä»·å¥½çš„å•†å“"
é‡å†™åï¼š"æˆ‘è¦ä¹°æ‰“æŠ˜+å¥½è¯„çš„å•†å“"
æ„æ€ä¸€æ ·ï¼Œä½†æ›´ç®€æ´æ¸…æ¥š

åŸSQLï¼šå¤æ‚ã€ä½æ•ˆ
é‡å†™SQLï¼šç®€æ´ã€é«˜æ•ˆ  
ç»“æœä¸€æ ·ï¼Œä½†æ€§èƒ½æ›´å¥½
```

### 4.2 å¸¸è§æŸ¥è¯¢é‡å†™æŠ€æœ¯


#### ğŸ”„ å­æŸ¥è¯¢é‡å†™ä¸ºJOIN


**é—®é¢˜æŸ¥è¯¢**ï¼š
```sql
-- ä½æ•ˆçš„å­æŸ¥è¯¢
SELECT * FROM orders 
WHERE customer_id IN (
  SELECT id FROM customers WHERE city = 'Beijing'
);
```

**é‡å†™ä¸ºJOIN**ï¼š
```sql
-- é«˜æ•ˆçš„JOINæŸ¥è¯¢
SELECT DISTINCT o.* FROM orders o
INNER JOIN customers c ON o.customer_id = c.id
WHERE c.city = 'Beijing';
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
```
å­æŸ¥è¯¢æ–¹å¼ï¼šå¯¹æ¯ä¸ªorderéƒ½è¦æ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢
JOINæ–¹å¼ï¼šä¸€æ¬¡æ€§å…³è”ï¼Œåˆ©ç”¨ç´¢å¼•å¿«é€ŸåŒ¹é…
æ€§èƒ½æå‡ï¼šé€šå¸¸å¿«3-10å€
```

#### ğŸ“Š EXISTS vs IN é‡å†™


**ä½¿ç”¨EXISTSï¼ˆæ¨èï¼‰**ï¼š
```sql
-- æ£€æŸ¥å­˜åœ¨æ€§ç”¨EXISTS
SELECT * FROM customers c
WHERE EXISTS (
  SELECT 1 FROM orders o 
  WHERE o.customer_id = c.id 
  AND o.status = 'paid'
);
```

**é¿å…NOT IN**ï¼š
```sql
-- é—®é¢˜ï¼šNOT INé‡åˆ°NULLå€¼ä¼šæœ‰é—®é¢˜
SELECT * FROM customers 
WHERE id NOT IN (SELECT customer_id FROM orders);

-- æ¨èï¼šç”¨LEFT JOIN + IS NULL
SELECT c.* FROM customers c
LEFT JOIN orders o ON c.id = o.customer_id
WHERE o.customer_id IS NULL;
```

#### ğŸ¯ UNIONä¼˜åŒ–æŠ€æœ¯


**åœºæ™¯ï¼šæŸ¥è¯¢å¤šç§æ¡ä»¶çš„æ•°æ®**
```sql
-- ä½æ•ˆï¼šORæ¡ä»¶å¯èƒ½ä¸èµ°ç´¢å¼•
SELECT * FROM orders 
WHERE (status = 'paid' AND amount > 1000)
   OR (status = 'pending' AND create_time > '2025-01-01');

-- é«˜æ•ˆï¼šåˆ†åˆ«èµ°ç´¢å¼•å†åˆå¹¶
SELECT * FROM orders 
WHERE status = 'paid' AND amount > 1000
UNION
SELECT * FROM orders 
WHERE status = 'pending' AND create_time > '2025-01-01';
```

### 4.3 åˆ†é¡µæŸ¥è¯¢é‡å†™


**ä¼ ç»Ÿåˆ†é¡µé—®é¢˜**ï¼š
```sql
-- é—®é¢˜ï¼šæ·±åˆ†é¡µå¾ˆæ…¢
SELECT * FROM orders ORDER BY id LIMIT 100000, 20;
-- éœ€è¦æ‰«æ100020è¡Œï¼Œåªè¿”å›20è¡Œï¼Œæµªè´¹ä¸¥é‡
```

**æ¸¸æ ‡åˆ†é¡µé‡å†™**ï¼š
```sql
-- æ–¹æ¡ˆï¼šåŸºäºä¸Šæ¬¡æŸ¥è¯¢ç»“æœ
-- ç¬¬ä¸€é¡µ
SELECT * FROM orders ORDER BY id LIMIT 20;

-- ç¬¬äºŒé¡µï¼ˆå‡è®¾ç¬¬ä¸€é¡µæœ€å¤§IDæ˜¯1020ï¼‰
SELECT * FROM orders WHERE id > 1020 ORDER BY id LIMIT 20;

-- ç¬¬ä¸‰é¡µï¼ˆå‡è®¾ç¬¬äºŒé¡µæœ€å¤§IDæ˜¯1040ï¼‰  
SELECT * FROM orders WHERE id > 1040 ORDER BY id LIMIT 20;
```

### 4.4 èšåˆæŸ¥è¯¢é‡å†™


**COUNTä¼˜åŒ–**ï¼š
```sql
-- é—®é¢˜ï¼šCOUNT(*)å¾ˆæ…¢
SELECT COUNT(*) FROM orders WHERE status = 'paid';

-- æ–¹æ¡ˆ1ï¼šé¢„è®¡ç®—ç»Ÿè®¡è¡¨
CREATE TABLE order_stats (
  status VARCHAR(20),
  count_value INT,
  updated_at TIMESTAMP
);

-- æ–¹æ¡ˆ2ï¼šä¼°ç®—COUNTï¼ˆé€‚ç”¨äºä¸éœ€è¦ç²¾ç¡®å€¼ï¼‰
SELECT table_rows FROM information_schema.tables 
WHERE table_schema = 'your_db' AND table_name = 'orders';
```

**GROUP BYä¼˜åŒ–**ï¼š
```sql
-- é—®é¢˜ï¼šå¤æ‚çš„GROUP BY
SELECT customer_id, COUNT(*), SUM(amount)
FROM orders 
WHERE create_time > '2025-01-01'
GROUP BY customer_id
HAVING COUNT(*) > 5;

-- ä¼˜åŒ–ï¼šç¡®ä¿GROUP BYå­—æ®µæœ‰ç´¢å¼•
CREATE INDEX idx_customer_time ON orders(customer_id, create_time);
```

### 4.5 æŸ¥è¯¢é‡å†™å·¥å…·


**MySQL Query Rewriteræ’ä»¶**ï¼š
```sql
-- å®‰è£…æŸ¥è¯¢é‡å†™æ’ä»¶
INSTALL PLUGIN rewriter SONAME 'rewriter.so';

-- æ·»åŠ é‡å†™è§„åˆ™
INSERT INTO query_rewrite.rewrite_rules(pattern, replacement) VALUES(
  'SELECT * FROM orders WHERE customer_id = ?',
  'SELECT id, customer_id, amount, status FROM orders WHERE customer_id = ?'
);

-- åŠ è½½è§„åˆ™
CALL query_rewrite.flush_rewrite_rules();
```

---

## 5. ğŸ“‹ SQLå®¡æ ¸è¿ç»´æµç¨‹


### 5.1 SQLå®¡æ ¸åŸºæœ¬æ¦‚å¿µ


**ä¸ºä»€ä¹ˆéœ€è¦SQLå®¡æ ¸**ï¼š
å°±åƒå»ºæˆ¿å­éœ€è¦å®¡æ ¸å›¾çº¸ä¸€æ ·ï¼ŒSQLä¸Šçº¿å‰ä¹Ÿéœ€è¦å®¡æ ¸ï¼Œé˜²æ­¢"è±†è…æ¸£å·¥ç¨‹"å½±å“æ•°æ®åº“æ€§èƒ½ã€‚

```
æ²¡æœ‰å®¡æ ¸çš„åæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¼€å‘å†™SQL    â”‚
â”‚ ç›´æ¥ä¸Šçº¿     â”‚ â†’ ğŸ’¥ æ•°æ®åº“å´©æºƒ
â”‚ å½±å“å…¨ç«™     â”‚    ğŸ’¥ ç”¨æˆ·æ— æ³•è®¿é—®  
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœ‰å®¡æ ¸çš„æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¼€å‘å†™SQL    â”‚ â†’  â”‚ DBAå®¡æ ¸     â”‚ â†’  â”‚ å®‰å…¨ä¸Šçº¿     â”‚
â”‚ æäº¤ç”³è¯·     â”‚    â”‚ æ€§èƒ½æµ‹è¯•     â”‚    â”‚ ç›‘æ§è¿è¡Œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 SQLå®¡æ ¸æ£€æŸ¥é¡¹


**åŸºç¡€è§„èŒƒæ£€æŸ¥**ï¼š
```sql
-- âœ… å¥½çš„SQLç¤ºä¾‹
SELECT id, name, email 
FROM users 
WHERE status = 'active' 
AND create_time > '2025-01-01'
LIMIT 100;

-- âŒ éœ€è¦å®¡æ ¸çš„é—®é¢˜SQL
SELECT * FROM users;  -- é—®é¢˜1ï¼šSELECT *
WHERE name LIKE '%å¼ %';  -- é—®é¢˜2ï¼šå‰ç½®é€šé…ç¬¦
-- é—®é¢˜3ï¼šæ²¡æœ‰LIMITé™åˆ¶
```

**æ€§èƒ½é£é™©æ£€æŸ¥**ï¼š

| æ£€æŸ¥é¡¹ | é£é™©ç­‰çº§ | é—®é¢˜ç¤ºä¾‹ | å®¡æ ¸å»ºè®® |
|--------|----------|----------|----------|
| `SELECT *` | ğŸŸ¡ ä¸­ç­‰ | `SELECT * FROM table` | æ˜ç¡®æŒ‡å®šå­—æ®µ |
| `å‰ç½®é€šé…ç¬¦` | ğŸ”´ é«˜å± | `LIKE '%keyword'` | é¿å…æˆ–ä½¿ç”¨å…¨æ–‡ç´¢å¼• |
| `æ— WHEREæ¡ä»¶` | ğŸ”´ é«˜å± | `UPDATE table SET ...` | å¿…é¡»æ·»åŠ WHERE |
| `å¤§è¡¨JOIN` | ğŸŸ¡ ä¸­ç­‰ | `åƒä¸‡çº§è¡¨JOIN` | æ£€æŸ¥ç´¢å¼•å’Œæ‰§è¡Œè®¡åˆ’ |
| `å­æŸ¥è¯¢åµŒå¥—` | ğŸŸ¡ ä¸­ç­‰ | `å¤šå±‚åµŒå¥—å­æŸ¥è¯¢` | è€ƒè™‘é‡å†™ä¸ºJOIN |

### 5.3 è‡ªåŠ¨åŒ–å®¡æ ¸å·¥å…·


**Inceptionè‡ªåŠ¨å®¡æ ¸**ï¼š
```python
# é…ç½®å®¡æ ¸è§„åˆ™
inception_config = {
    'inception_check_select_star': 1,      # æ£€æŸ¥SELECT *
    'inception_check_index_column_count': 5, # ç´¢å¼•å­—æ®µæ•°é‡é™åˆ¶
    'inception_max_key_length': 3072,      # ç´¢å¼•é•¿åº¦é™åˆ¶
    'inception_support_charset': 'utf8mb4', # æ”¯æŒçš„å­—ç¬¦é›†
}

# å®¡æ ¸SQLç¤ºä¾‹
def audit_sql(sql_text):
    """SQLå®¡æ ¸å‡½æ•°"""
    audit_result = inception.audit(sql_text)
    
    for result in audit_result:
        if result.level == 'ERROR':
            print(f"âŒ é”™è¯¯: {result.message}")
        elif result.level == 'WARNING':
            print(f"âš ï¸ è­¦å‘Š: {result.message}")
        else:
            print(f"âœ… é€šè¿‡: {result.message}")
    
    return audit_result
```

### 5.4 å®¡æ ¸æµç¨‹è®¾è®¡


**æ ‡å‡†å®¡æ ¸æµç¨‹**ï¼š
```
å¼€å‘é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¼€å‘å†™SQL â”‚
â”‚ 2. æœ¬åœ°æµ‹è¯•  â”‚ 
â”‚ 3. æäº¤ç”³è¯·  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
å®¡æ ¸é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è‡ªåŠ¨å®¡æ ¸  â”‚ â† Inceptionç­‰å·¥å…·
â”‚ 2. DBAäººå·¥å®¡æ ¸â”‚ â† å¤æ‚SQLäººå·¥æ£€æŸ¥
â”‚ 3. æ€§èƒ½æµ‹è¯•  â”‚ â† æµ‹è¯•ç¯å¢ƒéªŒè¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
ä¸Šçº¿é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”Ÿäº§æ‰§è¡Œ  â”‚ â† åœ¨ç»´æŠ¤çª—å£æ‰§è¡Œ
â”‚ 2. æ€§èƒ½ç›‘æ§  â”‚ â† ç›‘æ§SQLæ‰§è¡Œæƒ…å†µ
â”‚ 3. å›æ»šé¢„æ¡ˆ  â”‚ â† å‡†å¤‡åº”æ€¥æ–¹æ¡ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 å®¡æ ¸æ ‡å‡†åˆ¶å®š


**SQLç¼–å†™è§„èŒƒ**ï¼š
```sql
-- å‘½åè§„èŒƒ
è¡¨åï¼šuser_profile ï¼ˆä¸‹åˆ’çº¿åˆ†éš”ï¼Œå°å†™ï¼‰
å­—æ®µåï¼šcreate_time ï¼ˆè§åçŸ¥æ„ï¼‰
ç´¢å¼•åï¼šidx_user_status ï¼ˆå‰ç¼€+è¡¨å+å­—æ®µï¼‰

-- æŸ¥è¯¢è§„èŒƒ
âœ… SELECT user_id, username FROM users WHERE status = 1 LIMIT 100;
âŒ select * from users where username like '%admin%';

-- DDLè§„èŒƒ  
âœ… ALTER TABLE users ADD INDEX idx_status (status);
âŒ ALTER TABLE users ADD COLUMN new_field TEXT; -- å¤§è¡¨åŠ å­—æ®µéœ€è¦ç‰¹æ®Šå¤„ç†
```

---

## 6. ğŸ“ˆ æŸ¥è¯¢æ€§èƒ½åŸºçº¿ç®¡ç†


### 6.1 æ€§èƒ½åŸºçº¿æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ€§èƒ½åŸºçº¿**ï¼š
å°±åƒä½“æ£€æ—¶çš„å„é¡¹æ­£å¸¸æŒ‡æ ‡ä¸€æ ·ï¼Œæ€§èƒ½åŸºçº¿æ˜¯æ•°æ®åº“æ­£å¸¸è¿è¡Œæ—¶çš„å„é¡¹æ€§èƒ½æŒ‡æ ‡æ ‡å‡†å€¼ã€‚

```
ä½“æ£€åŸºçº¿ï¼š          æ•°æ®åº“åŸºçº¿ï¼š
è¡€å‹: 120/80        QPS: 1000/ç§’
å¿ƒç‡: 70æ¬¡/åˆ†       å¹³å‡å“åº”æ—¶é—´: 50ms  
ä½“æ¸©: 36.5Â°C       è¿æ¥æ•°: 200
è¡€ç³–: 5.6mmol/L     æ…¢æŸ¥è¯¢: <1%
```

### 6.2 åŸºçº¿æŒ‡æ ‡ä½“ç³»


**æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ç±»åˆ« | æŒ‡æ ‡åç§° | æ­£å¸¸èŒƒå›´ | ç›‘æ§æ–¹æ³• |
|----------|----------|----------|----------|
| **ååé‡** | QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰ | æ ¹æ®ä¸šåŠ¡ | `SHOW STATUS LIKE 'Questions'` |
| **å“åº”æ—¶é—´** | å¹³å‡æŸ¥è¯¢æ—¶é—´ | <100ms | æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ |
| **å¹¶å‘è¿æ¥** | æ´»è·ƒè¿æ¥æ•° | <æœ€å¤§è¿æ¥æ•°80% | `SHOW STATUS LIKE 'Threads_connected'` |
| **ç¼“å­˜å‘½ä¸­** | æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ | >90% | `SHOW STATUS LIKE 'Qcache%'` |
| **ç´¢å¼•æ•ˆç‡** | ç´¢å¼•ä½¿ç”¨ç‡ | >95% | `Handler_read_*`ç»Ÿè®¡ |

### 6.3 åŸºçº¿æ•°æ®é‡‡é›†


**è‡ªåŠ¨åŒ–é‡‡é›†è„šæœ¬**ï¼š
```bash
#!/bin/bash
# MySQLæ€§èƒ½åŸºçº¿é‡‡é›†è„šæœ¬

MYSQL_USER="monitor"
MYSQL_PASS="password"
LOG_FILE="/var/log/mysql_baseline.log"

# é‡‡é›†æ€§èƒ½æ•°æ®
collect_metrics() {
    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
    
    # QPSè®¡ç®—
    QPS=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -e "
        SHOW STATUS LIKE 'Questions';" | awk 'NR==2{print $2}')
    
    # è¿æ¥æ•°
    CONNECTIONS=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -e "
        SHOW STATUS LIKE 'Threads_connected';" | awk 'NR==2{print $2}')
    
    # æ…¢æŸ¥è¯¢æ•°é‡
    SLOW_QUERIES=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -e "
        SHOW STATUS LIKE 'Slow_queries';" | awk 'NR==2{print $2}')
    
    # è®°å½•åˆ°æ—¥å¿—
    echo "$TIMESTAMP,QPS:$QPS,Connections:$CONNECTIONS,SlowQueries:$SLOW_QUERIES" >> $LOG_FILE
}

# æ¯åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡
while true; do
    collect_metrics
    sleep 60
done
```

### 6.4 åŸºçº¿åˆ†æå’Œå»ºç«‹


**å†å²æ•°æ®åˆ†æ**ï¼š
```sql
-- åˆ†ææŸ¥è¯¢æ¨¡å¼
SELECT 
    HOUR(created_at) as hour,
    COUNT(*) as query_count,
    AVG(query_time) as avg_time
FROM query_log 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY HOUR(created_at)
ORDER BY hour;

-- ç»“æœåˆ†æï¼š
-- 9-18ç‚¹ï¼šé«˜å³°æœŸï¼ŒQPS 2000+
-- 18-23ç‚¹ï¼šå¹³å³°æœŸï¼ŒQPS 1000+  
-- 23-9ç‚¹ï¼šä½å³°æœŸï¼ŒQPS 500+
```

**åŸºçº¿é˜ˆå€¼è®¾å®š**ï¼š
```python
# åŸºçº¿é˜ˆå€¼é…ç½®
baseline_config = {
    'qps': {
        'peak_hours': {'min': 1500, 'max': 3000},      # é«˜å³°æœŸ
        'normal_hours': {'min': 800, 'max': 1500},     # å¹³å³°æœŸ
        'low_hours': {'min': 200, 'max': 800}          # ä½å³°æœŸ
    },
    'response_time': {
        'avg': 100,  # å¹³å‡å“åº”æ—¶é—´é˜ˆå€¼(ms)
        'p95': 500,  # 95%è¯·æ±‚å“åº”æ—¶é—´é˜ˆå€¼
        'p99': 1000  # 99%è¯·æ±‚å“åº”æ—¶é—´é˜ˆå€¼
    },
    'slow_query_ratio': 0.01  # æ…¢æŸ¥è¯¢æ¯”ä¾‹é˜ˆå€¼(1%)
}
```

### 6.5 åŸºçº¿ç›‘æ§å‘Šè­¦


**å‘Šè­¦è§„åˆ™é…ç½®**ï¼š
```yaml
# Prometheuså‘Šè­¦è§„åˆ™
groups:
- name: mysql_baseline_alerts
  rules:
  # QPSå¼‚å¸¸å‘Šè­¦
  - alert: MySQLQPSAbnormal
    expr: mysql_global_status_questions_rate > 3000 OR mysql_global_status_questions_rate < 200
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "MySQL QPSå¼‚å¸¸"
      description: "å½“å‰QPS: {{ $value }}ï¼Œè¶…å‡ºåŸºçº¿èŒƒå›´"
  
  # å“åº”æ—¶é—´å‘Šè­¦  
  - alert: MySQLSlowResponse
    expr: mysql_avg_query_time > 100
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "MySQLå“åº”æ—¶é—´è¿‡æ…¢"
      description: "å¹³å‡å“åº”æ—¶é—´: {{ $value }}ms"
```

### 6.6 åŸºçº¿ç»´æŠ¤æ›´æ–°


**å®šæœŸåŸºçº¿æ›´æ–°**ï¼š
```python
def update_baseline():
    """å®šæœŸæ›´æ–°æ€§èƒ½åŸºçº¿"""
    
    # åˆ†ææœ€è¿‘30å¤©æ•°æ®
    recent_data = analyze_recent_performance(days=30)
    
    # è®¡ç®—æ–°çš„åŸºçº¿å€¼
    new_baseline = {
        'qps_avg': recent_data['qps'].mean(),
        'qps_p95': recent_data['qps'].percentile(95),
        'response_time_avg': recent_data['response_time'].mean(),
        'response_time_p95': recent_data['response_time'].percentile(95)
    }
    
    # ä¸å½“å‰åŸºçº¿å¯¹æ¯”
    if abs(new_baseline['qps_avg'] - current_baseline['qps_avg']) > 200:
        print("âš ï¸ QPSåŸºçº¿å‘ç”Ÿæ˜¾è‘—å˜åŒ–ï¼Œéœ€è¦äººå·¥å®¡æ ¸")
        
    # æ›´æ–°åŸºçº¿é…ç½®
    save_baseline_config(new_baseline)
    
# æ¯å‘¨æ‰§è¡Œä¸€æ¬¡åŸºçº¿æ›´æ–°
schedule.every().sunday.at("02:00").do(update_baseline)
```

---

## 7. ğŸ”„ SQLå˜æ›´å½±å“è¯„ä¼°


### 7.1 å˜æ›´å½±å“è¯„ä¼°æ¦‚å¿µ


**ä¸ºä»€ä¹ˆéœ€è¦å½±å“è¯„ä¼°**ï¼š
å°±åƒè£…ä¿®æˆ¿å­å‰è¦è¯„ä¼°å¯¹é‚»å±…çš„å½±å“ä¸€æ ·ï¼ŒSQLå˜æ›´å‰ä¹Ÿè¦è¯„ä¼°å¯¹æ•°æ®åº“å’Œä¸šåŠ¡çš„å½±å“ã€‚

```
æ²¡æœ‰è¯„ä¼°çš„é£é™©ï¼š                æœ‰è¯„ä¼°çš„å®‰å…¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›´æ¥ä¸Šçº¿å˜æ›´ â”‚ â†’ ğŸ’¥ é”è¡¨    â”‚ æå‰è¯„ä¼°     â”‚ â†’ âœ… å®‰å…¨ä¸Šçº¿
â”‚ å½±å“ä¸šåŠ¡    â”‚   ğŸ’¥ æ•°æ®ä¸¢å¤± â”‚ åˆ¶å®šæ–¹æ¡ˆ     â”‚   âœ… å¹³ç¨³è¿è¡Œ
â”‚ ç”¨æˆ·æŠ•è¯‰    â”‚   ğŸ’¥ ç³»ç»Ÿå´©æºƒ â”‚ ç›‘æ§æ‰§è¡Œ     â”‚   âœ… å¿«é€Ÿå›æ»š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å˜æ›´ç±»å‹åˆ†æ


**DDLå˜æ›´å½±å“è¯„ä¼°**ï¼š

| å˜æ›´ç±»å‹ | å½±å“èŒƒå›´ | é£é™©ç­‰çº§ | è¯„ä¼°è¦ç‚¹ |
|----------|----------|----------|----------|
| `ADD COLUMN` | ğŸŸ¡ è¡¨ç»“æ„ | ä¸­ç­‰ | é»˜è®¤å€¼ã€è¡¨å¤§å°ã€é”æ—¶é—´ |
| `DROP COLUMN` | ğŸ”´ æ•°æ®+åº”ç”¨ | é«˜å± | æ•°æ®å¤‡ä»½ã€åº”ç”¨å…¼å®¹æ€§ |
| `ADD INDEX` | ğŸŸ¡ æ€§èƒ½ | ä¸­ç­‰ | è¡¨å¤§å°ã€åˆ›å»ºæ—¶é—´ã€é”å½±å“ |
| `DROP INDEX` | ğŸ”´ æ€§èƒ½ | é«˜å± | æŸ¥è¯¢æ€§èƒ½å½±å“åˆ†æ |
| `MODIFY COLUMN` | ğŸ”´ æ•°æ®+æ€§èƒ½ | é«˜å± | æ•°æ®è½¬æ¢ã€åº”ç”¨å…¼å®¹æ€§ |

**DMLå˜æ›´å½±å“è¯„ä¼°**ï¼š
```sql
-- ä½é£é™©ï¼šå°èŒƒå›´æ›´æ–°
UPDATE users SET last_login = NOW() WHERE id = 1;

-- ä¸­é£é™©ï¼šæ‰¹é‡æ›´æ–°
UPDATE orders SET status = 'shipped' 
WHERE status = 'paid' AND create_time < '2025-01-01';

-- é«˜é£é™©ï¼šå…¨è¡¨æ›´æ–°  
UPDATE products SET price = price * 1.1;  -- éœ€è¦åˆ†æ‰¹æ‰§è¡Œ
```

### 7.3 å˜æ›´å‰ç½®æ£€æŸ¥


**è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬**ï¼š
```python
def pre_change_check(sql_statement, table_name):
    """å˜æ›´å‰ç½®æ£€æŸ¥"""
    
    results = []
    
    # 1. è¡¨å¤§å°æ£€æŸ¥
    table_size = get_table_size(table_name)
    if table_size > 10 * 1024 * 1024 * 1024:  # 10GB
        results.append({
            'level': 'WARNING',
            'message': f'è¡¨ {table_name} å¤§å°ä¸º {table_size/1024/1024/1024:.2f}GBï¼Œå˜æ›´éœ€è¦è¾ƒé•¿æ—¶é—´'
        })
    
    # 2. é”æ—¶é—´è¯„ä¼°
    if 'ADD INDEX' in sql_statement.upper():
        estimated_time = estimate_index_creation_time(table_name)
        results.append({
            'level': 'INFO', 
            'message': f'é¢„ä¼°åˆ›å»ºç´¢å¼•æ—¶é—´: {estimated_time} åˆ†é’Ÿ'
        })
    
    # 3. ä¾èµ–æ£€æŸ¥
    if 'DROP' in sql_statement.upper():
        dependencies = check_dependencies(table_name, sql_statement)
        if dependencies:
            results.append({
                'level': 'ERROR',
                'message': f'å‘ç°ä¾èµ–å…³ç³»: {dependencies}'
            })
    
    return results

# ä½¿ç”¨ç¤ºä¾‹
check_result = pre_change_check(
    "ALTER TABLE orders ADD INDEX idx_status (status)",
    "orders"
)
```

### 7.4 å˜æ›´æ‰§è¡Œç­–ç•¥


**å¤§è¡¨DDLåœ¨çº¿æ‰§è¡Œ**ï¼š
```bash
# ä½¿ç”¨pt-online-schema-changeå·¥å…·
pt-online-schema-change \
  --alter "ADD INDEX idx_customer_time (customer_id, create_time)" \
  --host=localhost \
  --user=root \
  --password=password \
  D=ecommerce,t=orders \
  --execute

# æ‰§è¡ŒåŸç†ï¼š
# 1. åˆ›å»ºæ–°è¡¨ï¼ˆå¸¦æ–°ç´¢å¼•ï¼‰
# 2. æ•°æ®é€æ­¥æ‹·è´åˆ°æ–°è¡¨
# 3. è¿½è¸ªå˜æ›´æ•°æ®
# 4. åŸå­æ€§åˆ‡æ¢è¡¨å
```

**åˆ†æ‰¹æ•°æ®æ›´æ–°**ï¼š
```python
def batch_update(sql_template, batch_size=1000):
    """åˆ†æ‰¹æ‰§è¡Œå¤§é‡æ•°æ®æ›´æ–°"""
    
    offset = 0
    total_updated = 0
    
    while True:
        # åˆ†æ‰¹æ›´æ–°
        sql = f"""
        UPDATE orders 
        SET status = 'completed' 
        WHERE status = 'paid' 
        AND id > {offset} 
        AND id <= {offset + batch_size}
        """
        
        affected_rows = execute_sql(sql)
        total_updated += affected_rows
        
        if affected_rows == 0:
            break
            
        offset += batch_size
        
        # æš‚åœä¸€ä¸‹ï¼Œé¿å…å‹åŠ›è¿‡å¤§
        time.sleep(0.1)
        
        print(f"å·²æ›´æ–° {total_updated} è¡Œæ•°æ®")
    
    return total_updated
```

### 7.5 å˜æ›´å›æ»šæ–¹æ¡ˆ


**DDLå›æ»šæ–¹æ¡ˆ**ï¼š
```sql
-- å˜æ›´å‰å¤‡ä»½
CREATE TABLE orders_backup_20250909 AS SELECT * FROM orders;

-- æ‰§è¡Œå˜æ›´
ALTER TABLE orders ADD COLUMN new_field VARCHAR(100);

-- å¦‚éœ€å›æ»š
-- 1. æ•°æ®å›æ»š
DROP TABLE orders;
RENAME TABLE orders_backup_20250909 TO orders;

-- 2. ç»“æ„å›æ»šï¼ˆè®°å½•åŸå§‹ç»“æ„ï¼‰
-- å˜æ›´å‰ï¼šSHOW CREATE TABLE orders; ä¿å­˜ç»“æœ
-- å›æ»šæ—¶ï¼šæŒ‰åŸå§‹ç»“æ„é‡å»ºè¡¨
```

**DMLå›æ»šæ–¹æ¡ˆ**ï¼š
```sql
-- æ›´æ–°å‰å¤‡ä»½å½±å“æ•°æ®
CREATE TABLE temp_backup AS 
SELECT id, status FROM orders 
WHERE status = 'paid' AND create_time < '2025-01-01';

-- æ‰§è¡Œæ›´æ–°
UPDATE orders SET status = 'shipped' 
WHERE status = 'paid' AND create_time < '2025-01-01';

-- å¦‚éœ€å›æ»š
UPDATE orders o 
INNER JOIN temp_backup b ON o.id = b.id 
SET o.status = b.status;
```

### 7.6 å˜æ›´ç›‘æ§éªŒè¯


**å˜æ›´åéªŒè¯æ£€æŸ¥**ï¼š
```python
def post_change_validation(change_type, table_name):
    """å˜æ›´åéªŒè¯"""
    
    validations = []
    
    if change_type == 'ADD_INDEX':
        # éªŒè¯ç´¢å¼•æ˜¯å¦åˆ›å»ºæˆåŠŸ
        index_exists = check_index_exists(table_name)
        validations.append({
            'check': 'ç´¢å¼•åˆ›å»º',
            'result': 'âœ… æˆåŠŸ' if index_exists else 'âŒ å¤±è´¥'
        })
        
        # éªŒè¯æŸ¥è¯¢æ€§èƒ½
        query_performance = test_query_performance(table_name)
        validations.append({
            'check': 'æŸ¥è¯¢æ€§èƒ½',
            'result': f'å“åº”æ—¶é—´: {query_performance}ms'
        })
    
    elif change_type == 'ADD_COLUMN':
        # éªŒè¯åˆ—æ˜¯å¦æ·»åŠ æˆåŠŸ
        column_exists = check_column_exists(table_name)
        validations.append({
            'check': 'åˆ—æ·»åŠ ',
            'result': 'âœ… æˆåŠŸ' if column_exists else 'âŒ å¤±è´¥'
        })
        
        # éªŒè¯åº”ç”¨å…¼å®¹æ€§
        app_compatibility = test_app_queries(table_name)
        validations.append({
            'check': 'åº”ç”¨å…¼å®¹æ€§',
            'result': 'âœ… æ­£å¸¸' if app_compatibility else 'âŒ å¼‚å¸¸'
        })
    
    return validations
```

---

## 8. ğŸ—„ï¸ Query Cacheè¿ç»´ç­–ç•¥


### 8.1 Query CacheåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯Query Cache**ï¼š
å°±åƒæµè§ˆå™¨ç¼“å­˜ç½‘é¡µä¸€æ ·ï¼ŒQuery Cacheç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œç›¸åŒæŸ¥è¯¢ç›´æ¥è¿”å›ç¼“å­˜ç»“æœï¼Œä¸ç”¨é‡æ–°æ‰§è¡Œã€‚

```
æ²¡æœ‰Query Cacheï¼š          æœ‰Query Cacheï¼š
ç”¨æˆ·æŸ¥è¯¢ â†’ è§£æSQL          ç”¨æˆ·æŸ¥è¯¢ â†’ æ£€æŸ¥ç¼“å­˜ â†’ ç›´æ¥è¿”å›ç»“æœ âœ“
       â†’ ä¼˜åŒ–å™¨åˆ†æ                  â†“
       â†’ æ‰§è¡ŒæŸ¥è¯¢                   ç¼“å­˜æœªå‘½ä¸­
       â†’ è¿”å›ç»“æœ                   â†’ æ‰§è¡ŒæŸ¥è¯¢ â†’ ç¼“å­˜ç»“æœ â†’ è¿”å›ç»“æœ
```

> **æ³¨æ„**ï¼šMySQL 8.0å·²ç»ç§»é™¤äº†Query CacheåŠŸèƒ½ï¼Œå› ä¸ºåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ•ˆæœä¸ä½³ã€‚ä»¥ä¸‹å†…å®¹ä¸»è¦é€‚ç”¨äºMySQL 5.7åŠä»¥ä¸‹ç‰ˆæœ¬ã€‚

### 8.2 Query Cacheé…ç½®ç®¡ç†


**åŸºæœ¬é…ç½®å‚æ•°**ï¼š
```sql
-- æŸ¥çœ‹Query CacheçŠ¶æ€
SHOW VARIABLES LIKE 'query_cache%';

-- ä¸»è¦é…ç½®å‚æ•°ï¼š
-- query_cache_type: OFF/ON/DEMAND
-- query_cache_size: ç¼“å­˜å¤§å°(å­—èŠ‚)  
-- query_cache_limit: å•ä¸ªæŸ¥è¯¢ç»“æœæœ€å¤§ç¼“å­˜å¤§å°
-- query_cache_min_res_unit: æœ€å°åˆ†é…å•å…ƒ
```

**å¯ç”¨Query Cache**ï¼š
```ini
# my.cnfé…ç½®
[mysqld]
query_cache_type = 1        # å¯ç”¨æŸ¥è¯¢ç¼“å­˜
query_cache_size = 64M      # ç¼“å­˜å¤§å°64MB
query_cache_limit = 1M      # å•ä¸ªæŸ¥è¯¢æœ€å¤§1MB
query_cache_min_res_unit = 4096  # æœ€å°åˆ†é…4KB
```

### 8.3 Query Cacheæ€§èƒ½ç›‘æ§


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
```sql
-- æŸ¥çœ‹Query Cacheç»Ÿè®¡ä¿¡æ¯
SHOW STATUS LIKE 'Qcache%';

/*
é‡è¦æŒ‡æ ‡è§£è¯»ï¼š
Qcache_hits: ç¼“å­˜å‘½ä¸­æ¬¡æ•°ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰
Qcache_inserts: ç¼“å­˜æ’å…¥æ¬¡æ•°  
Qcache_not_cached: æœªç¼“å­˜æŸ¥è¯¢æ¬¡æ•°
Qcache_queries_in_cache: å½“å‰ç¼“å­˜çš„æŸ¥è¯¢æ•°
Qcache_free_memory: ç©ºé—²ç¼“å­˜å†…å­˜
Qcache_total_blocks: æ€»å†…å­˜å—æ•°
*/
```

**è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡**ï¼š
```sql
-- è®¡ç®—Query Cacheå‘½ä¸­ç‡
SELECT 
  ROUND(
    (Qcache_hits / (Qcache_hits + Qcache_inserts + Qcache_not_cached)) * 100, 2
  ) AS cache_hit_ratio
FROM (
  SELECT 
    variable_value AS Qcache_hits 
  FROM performance_schema.global_status 
  WHERE variable_name = 'Qcache_hits'
) h,
(
  SELECT 
    variable_value AS Qcache_inserts 
  FROM performance_schema.global_status 
  WHERE variable_name = 'Qcache_inserts'  
) i,
(
  SELECT 
    variable_value AS Qcache_not_cached
  FROM performance_schema.global_status
  WHERE variable_name = 'Qcache_not_cached'
) n;

-- ç›®æ ‡å‘½ä¸­ç‡: >80%ä¸ºè‰¯å¥½ï¼Œ>90%ä¸ºä¼˜ç§€
```

### 8.4 Query Cacheä¼˜åŒ–ç­–ç•¥


**é€‚åˆç¼“å­˜çš„æŸ¥è¯¢ç‰¹å¾**ï¼š
```sql
-- âœ… é€‚åˆç¼“å­˜ï¼šè¯»å¤šå†™å°‘çš„æŸ¥è¯¢
SELECT id, name, price FROM products WHERE category_id = 1;
SELECT COUNT(*) FROM users WHERE status = 'active';

-- âŒ ä¸é€‚åˆç¼“å­˜ï¼šé¢‘ç¹å˜æ›´çš„æ•°æ®
SELECT * FROM orders WHERE create_time > NOW() - INTERVAL 1 HOUR;
SELECT * FROM user_sessions WHERE last_activity > NOW() - INTERVAL 5 MINUTE;
```

**ç¼“å­˜å¤±æ•ˆç­–ç•¥**ï¼š
```sql
-- è¡¨æ•°æ®å˜æ›´ä¼šè®©ç›¸å…³ç¼“å­˜å¤±æ•ˆ
UPDATE products SET price = 999 WHERE id = 1;  -- productsè¡¨æ‰€æœ‰ç¼“å­˜å¤±æ•ˆ

-- ä½¿ç”¨SQL_NO_CACHEè·³è¿‡ç¼“å­˜
SELECT SQL_NO_CACHE * FROM products WHERE id = 1;

-- ä½¿ç”¨SQL_CACHEå¼ºåˆ¶ç¼“å­˜ï¼ˆquery_cache_type=DEMANDæ—¶ï¼‰
SELECT SQL_CACHE * FROM products WHERE category_id = 1;
```

### 8.5 Query Cacheé—®é¢˜è¯Šæ–­


**å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**ï¼š

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| å‘½ä¸­ç‡å¾ˆä½ | æŸ¥è¯¢ä¸é‡å¤/ç¼“å­˜å¤ªå° | å¢å¤§ç¼“å­˜/ä¼˜åŒ–æŸ¥è¯¢æ¨¡å¼ |
| å†…å­˜ç¢ç‰‡ä¸¥é‡ | min_res_unitè®¾ç½®ä¸å½“ | è°ƒæ•´åˆ†é…å•å…ƒå¤§å° |
| ç¼“å­˜é¢‘ç¹å¤±æ•ˆ | æ•°æ®æ›´æ–°é¢‘ç¹ | è€ƒè™‘å…³é—­Query Cache |
| æ€§èƒ½åè€Œä¸‹é™ | é«˜å¹¶å‘ä¸‹é”ç«äº‰ | å…³é—­Query Cache |

**å†…å­˜ç¢ç‰‡ç›‘æ§**ï¼š
```sql
-- æ£€æŸ¥å†…å­˜ç¢ç‰‡æƒ…å†µ
SELECT 
  Qcache_total_blocks,
  Qcache_free_blocks,
  Qcache_free_memory,
  (Qcache_free_blocks / Qcache_total_blocks) * 100 AS fragmentation_ratio
FROM (
  SELECT 
    (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Qcache_total_blocks') AS Qcache_total_blocks,
    (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Qcache_free_blocks') AS Qcache_free_blocks,
    (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Qcache_free_memory') AS Qcache_free_memory
) t;

-- ç¢ç‰‡ç‡>15%æ—¶éœ€è¦æ•´ç†ç¼“å­˜
FLUSH QUERY CACHE;  -- æ•´ç†ç¢ç‰‡
```

### 8.6 æ›¿ä»£æ–¹æ¡ˆæ¨è


**åº”ç”¨å±‚ç¼“å­˜**ï¼š
```python
# Redisç¼“å­˜ç¤ºä¾‹
import redis
import json

redis_client = redis.Redis(host='localhost', port=6379, db=0)

def get_products_by_category(category_id):
    # ç”Ÿæˆç¼“å­˜key
    cache_key = f"products:category:{category_id}"
    
    # å°è¯•ä»ç¼“å­˜è·å–
    cached_result = redis_client.get(cache_key)
    if cached_result:
        return json.loads(cached_result)
    
    # ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
    products = query_database(
        "SELECT id, name, price FROM products WHERE category_id = %s",
        (category_id,)
    )
    
    # ç¼“å­˜ç»“æœï¼ˆ5åˆ†é’Ÿè¿‡æœŸï¼‰
    redis_client.setex(cache_key, 300, json.dumps(products))
    
    return products
```

**ProxySQLæŸ¥è¯¢ç¼“å­˜**ï¼š
```sql
-- ProxySQLæŸ¥è¯¢è·¯ç”±å’Œç¼“å­˜é…ç½®
INSERT INTO mysql_query_rules (
  rule_id, active, match_pattern, cache_ttl, apply
) VALUES (
  1, 1, '^SELECT.*FROM products WHERE category_id.*', 60000, 1
);

-- ä¼˜åŠ¿ï¼š
-- 1. ä¸å½±å“MySQLæ€§èƒ½
-- 2. æ›´çµæ´»çš„ç¼“å­˜ç­–ç•¥  
-- 3. æ”¯æŒæŸ¥è¯¢è·¯ç”±
```

---

## 9. âš™ï¸ æŸ¥è¯¢ä¼˜åŒ–å™¨è¿ç»´è°ƒä¼˜


### 9.1 æŸ¥è¯¢ä¼˜åŒ–å™¨åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æŸ¥è¯¢ä¼˜åŒ–å™¨**ï¼š
æŸ¥è¯¢ä¼˜åŒ–å™¨å°±åƒGPSå¯¼èˆªç³»ç»Ÿï¼Œå®ƒä¼šåˆ†ææ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼Œé€‰æ‹©æˆæœ¬æœ€ä½çš„æ–¹æ¡ˆæ¥æ‰§è¡ŒSQLã€‚

```
ç”¨æˆ·è¯·æ±‚ï¼šä»Aåœ°åˆ°Båœ°                ç”¨æˆ·SQLï¼šSELECT * FROM orders WHERE...
         â†“                                    â†“
GPSåˆ†æï¼šè·¯å¾„1:10åˆ†é’Ÿ,è·¯å¾„2:15åˆ†é’Ÿ      ä¼˜åŒ–å™¨åˆ†æï¼šæ–¹æ¡ˆ1:æ‰«æ1000è¡Œ,æ–¹æ¡ˆ2:æ‰«æ10è¡Œ
         â†“                                    â†“  
é€‰æ‹©æ–¹æ¡ˆï¼šèµ°è·¯å¾„1ï¼ˆæœ€å¿«ï¼‰               é€‰æ‹©æ–¹æ¡ˆï¼šç”¨æ–¹æ¡ˆ2ï¼ˆæˆæœ¬æœ€ä½ï¼‰
         â†“                                    â†“
å¼€å§‹å¯¼èˆªï¼šæŒ‰è·¯å¾„1è¡Œé©¶                  å¼€å§‹æ‰§è¡Œï¼šæŒ‰æ–¹æ¡ˆ2æ‰§è¡Œ
```

### 9.2 ä¼˜åŒ–å™¨å·¥ä½œåŸç†


**ä¼˜åŒ–å™¨å†³ç­–è¿‡ç¨‹**ï¼š
```
SQLè§£æ
    â†“
è¯­æ³•æ£€æŸ¥
    â†“
ç”Ÿæˆæ‰§è¡Œè®¡åˆ’å€™é€‰ â”Œâ”€ å…¨è¡¨æ‰«æ
    â†“           â”œâ”€ ç´¢å¼•æ‰«æ  
æˆæœ¬ä¼°ç®—        â”œâ”€ èŒƒå›´æ‰«æ
    â†“           â””â”€ JOINæ–¹æ³•é€‰æ‹©
é€‰æ‹©æœ€ä¼˜è®¡åˆ’
    â†“
æ‰§è¡ŒSQL
```

**æˆæœ¬è®¡ç®—è¦ç´ **ï¼š
- **I/Oæˆæœ¬**ï¼šè¯»å–æ•°æ®é¡µçš„ä»£ä»·
- **CPUæˆæœ¬**ï¼šå¤„ç†è¡Œè®°å½•çš„ä»£ä»·  
- **å†…å­˜æˆæœ¬**ï¼šæ’åºã€ä¸´æ—¶è¡¨çš„ä»£ä»·
- **ç½‘ç»œæˆæœ¬**ï¼šæ•°æ®ä¼ è¾“çš„ä»£ä»·

### 9.3 ä¼˜åŒ–å™¨ç»Ÿè®¡ä¿¡æ¯


**è¡¨ç»Ÿè®¡ä¿¡æ¯æŸ¥çœ‹**ï¼š
```sql
-- æŸ¥çœ‹è¡¨çš„ç»Ÿè®¡ä¿¡æ¯
SELECT 
  table_schema,
  table_name,
  table_rows,        -- ä¼°ç®—è¡Œæ•°
  avg_row_length,    -- å¹³å‡è¡Œé•¿åº¦
  data_length,       -- æ•°æ®å¤§å°
  index_length,      -- ç´¢å¼•å¤§å°
  update_time        -- æœ€åæ›´æ–°æ—¶é—´
FROM information_schema.tables 
WHERE table_schema = 'your_database';

-- æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
SELECT 
  table_name,
  index_name,
  seq_in_index,
  column_name,
  cardinality,       -- åŸºæ•°ï¼ˆä¸åŒå€¼çš„æ•°é‡ï¼‰
  nullable
FROM information_schema.statistics
WHERE table_schema = 'your_database'
ORDER BY table_name, index_name, seq_in_index;
```

**æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯**ï¼š
```sql
-- æ›´æ–°è¡¨çš„ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE orders;

-- æ‰¹é‡æ›´æ–°æ•°æ®åº“æ‰€æœ‰è¡¨
SELECT CONCAT('ANALYZE TABLE ', table_name, ';') 
FROM information_schema.tables 
WHERE table_schema = 'your_database';
```

### 9.4 ä¼˜åŒ–å™¨é…ç½®å‚æ•°


**å…³é”®é…ç½®å‚æ•°**ï¼š
```sql
-- æŸ¥çœ‹ä¼˜åŒ–å™¨ç›¸å…³å‚æ•°
SHOW VARIABLES LIKE '%optimizer%';

-- é‡è¦å‚æ•°è¯´æ˜ï¼š
-- optimizer_search_depth: ä¼˜åŒ–å™¨æœç´¢æ·±åº¦
-- optimizer_prune_level: å¯ç”¨ä¼˜åŒ–å™¨å‰ªæ
-- optimizer_use_condition_selectivity: æ¡ä»¶é€‰æ‹©æ€§ä¼°ç®—
-- eq_range_index_dive_limit: ç­‰å€¼èŒƒå›´ç´¢å¼•æ·±åº¦é™åˆ¶
```

**å‚æ•°è°ƒä¼˜ç¤ºä¾‹**ï¼š
```sql
-- è®¾ç½®ä¼˜åŒ–å™¨æœç´¢æ·±åº¦ï¼ˆé»˜è®¤62ï¼‰
SET SESSION optimizer_search_depth = 10;

-- åœ¨å¤æ‚JOINæŸ¥è¯¢è¾ƒå¤šæ—¶å¯ä»¥é™ä½æœç´¢æ·±åº¦ï¼Œæé«˜ä¼˜åŒ–é€Ÿåº¦
-- ä½†å¯èƒ½é”™è¿‡æ›´ä¼˜çš„æ‰§è¡Œè®¡åˆ’

-- è®¾ç½®ç­‰å€¼æ¡ä»¶æ•°é‡é™åˆ¶ï¼ˆé»˜è®¤200ï¼‰
SET SESSION eq_range_index_dive_limit = 100;

-- å½“INæ¡ä»¶å€¼å¾ˆå¤šæ—¶ï¼Œè®¾ç½®è¾ƒå°å€¼å¯ä»¥é¿å…ä¼˜åŒ–å™¨èŠ±å¤ªå¤šæ—¶é—´åˆ†æ
```

### 9.5 Hintæç¤ºä¼˜åŒ–


**ç´¢å¼•Hintä½¿ç”¨**ï¼š
```sql
-- å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç´¢å¼•
SELECT * FROM orders USE INDEX (idx_customer_time)
WHERE customer_id = 100 AND create_time > '2025-01-01';

-- å¼ºåˆ¶å¿½ç•¥æŸä¸ªç´¢å¼•
SELECT * FROM orders IGNORE INDEX (idx_status)  
WHERE status = 'paid' AND amount > 1000;

-- å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç´¢å¼•ï¼ˆæ›´å¼ºåˆ¶ï¼‰
SELECT * FROM orders FORCE INDEX (idx_customer_time)
WHERE customer_id = 100;
```

**JOIN Hintä½¿ç”¨**ï¼š
```sql
-- å¼ºåˆ¶åµŒå¥—å¾ªç¯è¿æ¥
SELECT /*+ USE_NL(o, c) */ o.*, c.name
FROM orders o
JOIN customers c ON o.customer_id = c.id;

-- å¼ºåˆ¶å“ˆå¸Œè¿æ¥ï¼ˆMySQL 8.0+ï¼‰
SELECT /*+ HASH_JOIN(o, c) */ o.*, c.name  
FROM orders o
JOIN customers c ON o.customer_id = c.id;

-- æ§åˆ¶JOINé¡ºåº
SELECT /*+ STRAIGHT_JOIN */ o.*, c.name
FROM orders o
JOIN customers c ON o.customer_id = c.id;
```

### 9.6 ä¼˜åŒ–å™¨é—®é¢˜è¯Šæ–­


**æ‰§è¡Œè®¡åˆ’åˆ†æ**ï¼š
```sql
-- ä½¿ç”¨EXPLAIN ANALYZEæŸ¥çœ‹å®é™…æ‰§è¡Œæƒ…å†µï¼ˆMySQL 8.0+ï¼‰
EXPLAIN ANALYZE 
SELECT o.*, c.name 
FROM orders o 
JOIN customers c ON o.customer_id = c.id 
WHERE o.create_time > '2025-01-01';

-- è¾“å‡ºåŒ…å«å®é™…æ‰§è¡Œæ—¶é—´å’Œè¡Œæ•°ï¼Œå¯ä»¥å¯¹æ¯”ä¼°ç®—å€¼
```

**ä¼˜åŒ–å™¨è¿½è¸ª**ï¼š
```sql
-- å¼€å¯ä¼˜åŒ–å™¨è¿½è¸ª
SET optimizer_trace='enabled=on';

-- æ‰§è¡ŒæŸ¥è¯¢
SELECT * FROM orders WHERE customer_id = 100;

-- æŸ¥çœ‹ä¼˜åŒ–å™¨å†³ç­–è¿‡ç¨‹
SELECT trace FROM information_schema.optimizer_trace;

-- å…³é—­è¿½è¸ª
SET optimizer_trace='enabled=off';
```

**å¸¸è§ä¼˜åŒ–å™¨é—®é¢˜**ï¼š

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| ä¸èµ°é¢„æœŸç´¢å¼• | ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸ | `ANALYZE TABLE` |
| JOINé¡ºåºä¸ä¼˜ | è¡¨å¤§å°ä¼°ç®—é”™è¯¯ | æ›´æ–°ç»Ÿè®¡ä¿¡æ¯/ä½¿ç”¨Hint |
| æˆæœ¬ä¼°ç®—åå·® | å‚æ•°é…ç½®ä¸å½“ | è°ƒæ•´ä¼˜åŒ–å™¨å‚æ•° |
| æ‰§è¡Œè®¡åˆ’ä¸ç¨³å®š | æ•°æ®åˆ†å¸ƒå˜åŒ– | å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ |

### 9.7 ä¼˜åŒ–å™¨è°ƒä¼˜å®è·µ


**å»ºç«‹ç›‘æ§ä½“ç³»**ï¼š
```python
def monitor_optimizer_performance():
    """ç›‘æ§ä¼˜åŒ–å™¨æ€§èƒ½"""
    
    # æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯æ›´æ–°æƒ…å†µ
    outdated_stats = check_outdated_statistics()
    if outdated_stats:
        print(f"âš ï¸ å‘ç°{len(outdated_stats)}ä¸ªè¡¨ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸ")
        
    # æ£€æŸ¥æ‰§è¡Œè®¡åˆ’å˜åŒ–
    plan_changes = detect_plan_changes()
    if plan_changes:
        print(f"âš ï¸ å‘ç°{len(plan_changes)}ä¸ªæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’å‘ç”Ÿå˜åŒ–")
        
    # æ£€æŸ¥Hintä½¿ç”¨æƒ…å†µ
    hint_usage = analyze_hint_usage()
    print(f"ğŸ“Š å½“å‰æœ‰{hint_usage['count']}ä¸ªæŸ¥è¯¢ä½¿ç”¨äº†Hint")
    
def auto_update_statistics():
    """è‡ªåŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯"""
    
    # è·å–æ•°æ®å˜åŒ–è¾ƒå¤§çš„è¡¨
    tables_need_update = find_tables_with_data_changes(threshold=0.1)  # 10%å˜åŒ–
    
    for table in tables_need_update:
        try:
            execute_sql(f"ANALYZE TABLE {table}")
            print(f"âœ… æ›´æ–°è¡¨ {table} ç»Ÿè®¡ä¿¡æ¯æˆåŠŸ")
        except Exception as e:
            print(f"âŒ æ›´æ–°è¡¨ {table} ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: {e}")

# å®šæœŸæ‰§è¡Œ
schedule.every().day.at("02:00").do(auto_update_statistics)
```

---

## 10. ğŸ“Š SQLæ‰§è¡Œç»Ÿè®¡åˆ†æ


### 10.1 æ‰§è¡Œç»Ÿè®¡åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯SQLæ‰§è¡Œç»Ÿè®¡**ï¼š
å°±åƒåˆ†æç½‘ç«™è®¿é—®æ—¥å¿—ä¸€æ ·ï¼ŒSQLæ‰§è¡Œç»Ÿè®¡å¸®æˆ‘ä»¬äº†è§£æ•°æ®åº“çš„ä½¿ç”¨æ¨¡å¼ï¼Œæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆå’Œä¼˜åŒ–æœºä¼šã€‚

```
ç½‘ç«™è®¿é—®åˆ†æï¼š                SQLæ‰§è¡Œåˆ†æï¼š
- å“ªä¸ªé¡µé¢è®¿é—®æœ€å¤š            - å“ªä¸ªSQLæ‰§è¡Œæœ€é¢‘ç¹
- å“ªä¸ªé¡µé¢åŠ è½½æœ€æ…¢            - å“ªä¸ªSQLè€—æ—¶æœ€é•¿  
- ç”¨æˆ·æ¥æºåˆ†æ                - å“ªä¸ªåº”ç”¨è°ƒç”¨æœ€å¤š
- çƒ­é—¨æ—¶é—´æ®µ                  - ä¸šåŠ¡é«˜å³°æ—¶æ®µ
```

### 10.2 Performance Schemaç»Ÿè®¡


**å¯ç”¨Performance Schema**ï¼š
```sql
-- æ£€æŸ¥Performance SchemaçŠ¶æ€
SHOW VARIABLES LIKE 'performance_schema';

-- æŸ¥çœ‹å·²å¯ç”¨çš„ç›‘æ§é¡¹
SELECT * FROM performance_schema.setup_instruments 
WHERE enabled = 'YES' AND name LIKE '%statement%';

-- å¯ç”¨SQLè¯­å¥ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET enabled = 'YES' 
WHERE name LIKE 'statement/%';

-- å¯ç”¨æ¶ˆè´¹è€…
UPDATE performance_schema.setup_consumers 
SET enabled = 'YES' 
WHERE name LIKE '%statement%';
```

### 10.3 SQLè¯­å¥ç»Ÿè®¡åˆ†æ


**æŸ¥è¯¢æ‰§è¡Œé¢‘ç‡ç»Ÿè®¡**ï¼š
```sql
-- æœ€é¢‘ç¹æ‰§è¡Œçš„SQLï¼ˆæŒ‰æ‰§è¡Œæ¬¡æ•°ï¼‰
SELECT 
  SUBSTRING(digest_text, 1, 100) AS sql_text,
  count_star AS exec_count,
  ROUND(avg_timer_wait/1000000000, 2) AS avg_time_sec,
  ROUND(sum_timer_wait/1000000000, 2) AS total_time_sec
FROM performance_schema.events_statements_summary_by_digest 
ORDER BY count_star DESC 
LIMIT 20;

-- æœ€è€—æ—¶çš„SQLï¼ˆæŒ‰æ€»è€—æ—¶ï¼‰
SELECT 
  SUBSTRING(digest_text, 1, 100) AS sql_text,
  count_star AS exec_count,
  ROUND(sum_timer_wait/1000000000, 2) AS total_time_sec,
  ROUND(avg_timer_wait/1000000000, 2) AS avg_time_sec
FROM performance_schema.events_statements_summary_by_digest 
ORDER BY sum_timer_wait DESC 
LIMIT 20;
```

**SQLæ€§èƒ½æŒ‡æ ‡è¯¦ç»†åˆ†æ**ï¼š
```sql
-- SQLæ‰§è¡Œè¯¦ç»†ç»Ÿè®¡
SELECT 
  digest_text,
  count_star AS execution_count,
  ROUND(avg_timer_wait/1000000000, 3) AS avg_execution_time_sec,
  ROUND(max_timer_wait/1000000000, 3) AS max_execution_time_sec,
  ROUND(avg_rows_examined, 2) AS avg_rows_examined,
  ROUND(avg_rows_sent, 2) AS avg_rows_sent,
  ROUND(avg_rows_affected, 2) AS avg_rows_affected,
  sum_created_tmp_tables AS tmp_tables_created,
  sum_created_tmp_disk_tables AS tmp_disk_tables_created,
  ROUND(sum_sort_rows/count_star, 2) AS avg_sort_rows
FROM performance_schema.events_statements_summary_by_digest 
WHERE count_star > 100  -- æ‰§è¡Œæ¬¡æ•°è¶…è¿‡100æ¬¡çš„SQL
ORDER BY avg_timer_wait DESC 
LIMIT 30;
```

### 10.4 å®æ—¶SQLç›‘æ§


**å½“å‰æ‰§è¡Œçš„SQL**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„SQL
SELECT 
  p.id AS process_id,
  p.user,
  p.host,
  p.db,
  p.command,
  p.time,
  p.state,
  p.info AS current_sql
FROM information_schema.processlist p
WHERE p.command != 'Sleep' 
  AND p.info IS NOT NULL
ORDER BY p.time DESC;

-- æŸ¥çœ‹å†å²æ‰§è¡Œçš„SQLï¼ˆæœ€è¿‘æ‰§è¡Œï¼‰
SELECT 
  event_id,
  SUBSTRING(sql_text, 1, 200) AS sql_preview,
  timer_start,
  timer_end,
  ROUND((timer_end - timer_start)/1000000000, 3) AS execution_time_sec,
  rows_examined,
  rows_sent
FROM performance_schema.events_statements_history 
ORDER BY timer_start DESC 
LIMIT 50;
```

### 10.5 SQLæ‰§è¡Œè¶‹åŠ¿åˆ†æ


**æŒ‰æ—¶é—´æ®µç»Ÿè®¡SQLæ‰§è¡Œæƒ…å†µ**ï¼š
```python
def analyze_sql_execution_trends():
    """åˆ†æSQLæ‰§è¡Œè¶‹åŠ¿"""
    
    # æŒ‰å°æ—¶ç»Ÿè®¡SQLæ‰§è¡Œæƒ…å†µ
    hourly_stats = """
    SELECT 
        HOUR(FROM_UNIXTIME(UNIX_TIMESTAMP() - (SELECT uptime FROM information_schema.global_status WHERE variable_name = 'Uptime') + timer_start/1000000000000)) AS hour,
        COUNT(*) AS query_count,
        ROUND(AVG(timer_wait/1000000000), 3) AS avg_time_sec,
        ROUND(SUM(timer_wait/1000000000), 3) AS total_time_sec
    FROM performance_schema.events_statements_history_long
    WHERE timer_start > (UNIX_TIMESTAMP() - 86400) * 1000000000000  -- æœ€è¿‘24å°æ—¶
    GROUP BY hour
    ORDER BY hour;
    """
    
    # æŒ‰SQLç±»å‹ç»Ÿè®¡
    sql_type_stats = """
    SELECT 
        CASE 
            WHEN UPPER(SUBSTRING(TRIM(sql_text), 1, 6)) = 'SELECT' THEN 'SELECT'
            WHEN UPPER(SUBSTRING(TRIM(sql_text), 1, 6)) = 'INSERT' THEN 'INSERT'
            WHEN UPPER(SUBSTRING(TRIM(sql_text), 1, 6)) = 'UPDATE' THEN 'UPDATE'
            WHEN UPPER(SUBSTRING(TRIM(sql_text), 1, 6)) = 'DELETE' THEN 'DELETE'
            ELSE 'OTHER'
        END AS sql_type,
        COUNT(*) AS execution_count,
        ROUND(AVG(timer_wait/1000000000), 3) AS avg_time_sec,
        ROUND(SUM(timer_wait/1000000000), 3) AS total_time_sec
    FROM performance_schema.events_statements_history_long
    GROUP BY sql_type
    ORDER BY execution_count DESC;
    """
    
    return {
        'hourly': execute_query(hourly_stats),
        'by_type': execute_query(sql_type_stats)
    }
```

### 10.6 SQLæ‰§è¡ŒæŠ¥å‘Šç”Ÿæˆ


**è‡ªåŠ¨åŒ–æ‰§è¡ŒæŠ¥å‘Š**ï¼š
```python
def generate_sql_execution_report(period='daily'):
    """ç”ŸæˆSQLæ‰§è¡Œç»Ÿè®¡æŠ¥å‘Š"""
    
    report = {
        'period': period,
        'generated_at': datetime.now().isoformat(),
        'summary': {},
        'top_queries': {},
        'performance_issues': []
    }
    
    # 1. æ€»ä½“æ¦‚è§ˆ
    report['summary'] = {
        'total_queries': get_total_query_count(),
        'avg_response_time': get_avg_response_time(),
        'slow_query_count': get_slow_query_count(),
        'error_count': get_error_count()
    }
    
    # 2. TOPæŸ¥è¯¢åˆ†æ
    report['top_queries'] = {
        'by_frequency': get_top_queries_by_frequency(limit=10),
        'by_total_time': get_top_queries_by_total_time(limit=10),
        'by_avg_time': get_top_queries_by_avg_time(limit=10)
    }
    
    # 3. æ€§èƒ½é—®é¢˜è¯†åˆ«
    issues = []
    
    # æ£€æŸ¥æ…¢æŸ¥è¯¢
    slow_queries = get_slow_queries()
    if slow_queries:
        issues.append({
            'type': 'slow_queries',
            'severity': 'high',
            'count': len(slow_queries),
            'description': f'å‘ç°{len(slow_queries)}ä¸ªæ…¢æŸ¥è¯¢'
        })
    
    # æ£€æŸ¥å…¨è¡¨æ‰«æ
    full_scans = get_full_table_scans()
    if full_scans:
        issues.append({
            'type': 'full_table_scan',
            'severity': 'medium', 
            'count': len(full_scans),
            'description': f'å‘ç°{len(full_scans)}ä¸ªå…¨è¡¨æ‰«ææŸ¥è¯¢'
        })
    
    # æ£€æŸ¥ä¸´æ—¶è¡¨ä½¿ç”¨
    temp_tables = get_temp_table_usage()
    if temp_tables:
        issues.append({
            'type': 'temp_tables',
            'severity': 'medium',
            'count': len(temp_tables),
            'description': f'å‘ç°{len(temp_tables)}ä¸ªä½¿ç”¨ä¸´æ—¶è¡¨çš„æŸ¥è¯¢'
        })
    
    report['performance_issues'] = issues
    
    return report

def format_report_output(report):
    """æ ¼å¼åŒ–è¾“å‡ºæŠ¥å‘Š"""
    
    print("=" * 80)
    print(f"ğŸ“Š MySQL SQLæ‰§è¡Œç»Ÿè®¡æŠ¥å‘Š - {report['period']}")
    print("=" * 80)
    
    # æ€»ä½“æ¦‚è§ˆ
    summary = report['summary']
    print(f"\nğŸ“ˆ æ€»ä½“æ¦‚è§ˆ:")
    print(f"  æ€»æŸ¥è¯¢æ•°: {summary['total_queries']:,}")
    print(f"  å¹³å‡å“åº”æ—¶é—´: {summary['avg_response_time']:.3f}ç§’")
    print(f"  æ…¢æŸ¥è¯¢æ•°: {summary['slow_query_count']:,}")
    print(f"  é”™è¯¯æŸ¥è¯¢æ•°: {summary['error_count']:,}")
    
    # TOPæŸ¥è¯¢
    print(f"\nğŸ”¥ çƒ­é—¨æŸ¥è¯¢ï¼ˆæŒ‰æ‰§è¡Œé¢‘ç‡ï¼‰:")
    for i, query in enumerate(report['top_queries']['by_frequency'][:5], 1):
        print(f"  {i}. æ‰§è¡Œ{query['count']:,}æ¬¡ - {query['sql'][:80]}...")
    
    # æ€§èƒ½é—®é¢˜
    if report['performance_issues']:
        print(f"\nâš ï¸  æ€§èƒ½é—®é¢˜:")
        for issue in report['performance_issues']:
            severity_icon = "ğŸ”´" if issue['severity'] == 'high' else "ğŸŸ¡"
            print(f"  {severity_icon} {issue['description']}")
    else:
        print(f"\nâœ… æœªå‘ç°æ˜æ˜¾æ€§èƒ½é—®é¢˜")
```

---

## 11. â±ï¸ æŸ¥è¯¢æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ


### 11.1 æ‰§è¡Œæ—¶é—´åˆ†å¸ƒæ¦‚å¿µ


**ä¸ºä»€ä¹ˆè¦åˆ†ææ—¶é—´åˆ†å¸ƒ**ï¼š
å°±åƒåŒ»ç”Ÿçœ‹ä½“æ£€æŠ¥å‘Šè¦çœ‹å„é¡¹æŒ‡æ ‡çš„åˆ†å¸ƒä¸€æ ·ï¼Œåˆ†æSQLæ‰§è¡Œæ—¶é—´åˆ†å¸ƒèƒ½å¸®æˆ‘ä»¬äº†è§£æ•°æ®åº“çš„å¥åº·çŠ¶å†µã€‚

```
è¡€å‹åˆ†å¸ƒï¼š           SQLæ‰§è¡Œæ—¶é—´åˆ†å¸ƒï¼š
æ­£å¸¸: 90%           <100ms: 85%     â† å¤§éƒ¨åˆ†æŸ¥è¯¢å¾ˆå¿«
ä¸´ç•Œ: 8%            100-500ms: 10%  â† å°‘éƒ¨åˆ†æŸ¥è¯¢è¾ƒæ…¢  
å¼‚å¸¸: 2%            >500ms: 5%      â† æå°‘æ•°æŸ¥è¯¢å¾ˆæ…¢

åˆ†æä»·å€¼ï¼š
- å‘ç°æ€§èƒ½å¼‚å¸¸
- åˆ¶å®šä¼˜åŒ–ç›®æ ‡  
- ç›‘æ§æ”¹è¿›æ•ˆæœ
```

### 11.2 æ—¶é—´åˆ†å¸ƒæ•°æ®é‡‡é›†


**åŸºäºPerformance Schemaé‡‡é›†**ï¼š
```sql
-- åˆ›å»ºæ—¶é—´åˆ†å¸ƒç»Ÿè®¡è§†å›¾
CREATE VIEW sql_time_distribution AS
SELECT 
  CASE 
    WHEN avg_timer_wait/1000000000 < 0.001 THEN '<1ms'
    WHEN avg_timer_wait/1000000000 < 0.01 THEN '1-10ms'
    WHEN avg_timer_wait/1000000000 < 0.1 THEN '10-100ms'
    WHEN avg_timer_wait/1000000000 < 0.5 THEN '100-500ms'
    WHEN avg_timer_wait/1000000000 < 1.0 THEN '500ms-1s'
    WHEN avg_timer_wait/1000000000 < 5.0 THEN '1-5s'
    ELSE '>5s'
  END AS time_range,
  COUNT(*) AS query_count,
  ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS percentage
FROM performance_schema.events_statements_summary_by_digest
WHERE count_star > 10  -- è‡³å°‘æ‰§è¡Œè¿‡10æ¬¡çš„SQL
GROUP BY time_range
ORDER BY 
  CASE time_range
    WHEN '<1ms' THEN 1
    WHEN '1-10ms' THEN 2 
    WHEN '10-100ms' THEN 3
    WHEN '100-500ms' THEN 4
    WHEN '500ms-1s' THEN 5
    WHEN '1-5s' THEN 6
    WHEN '>5s' THEN 7
  END;

-- æŸ¥çœ‹æ—¶é—´åˆ†å¸ƒ
SELECT * FROM sql_time_distribution;
```

**ç»“æœç¤ºä¾‹è§£è¯»**ï¼š
```
+-------------+-------------+------------+
| time_range  | query_count | percentage |
+-------------+-------------+------------+
| <1ms        |        450  |      45.00 |
| 1-10ms      |        320  |      32.00 |
| 10-100ms    |        150  |      15.00 |
| 100-500ms  |         60  |       6.00 |
| 500ms-1s    |         15  |       1.50 |
| 1-5s        |          4  |       0.40 |
| >5s         |          1  |       0.10 |
+-------------+-------------+------------+

è§£è¯»ï¼š
âœ… 77%çš„æŸ¥è¯¢åœ¨10mså†…å®Œæˆ - å¾ˆå¥½
ğŸŸ¡ 21%çš„æŸ¥è¯¢åœ¨100mså†…å®Œæˆ - å¯æ¥å—  
ğŸ”´ 2%çš„æŸ¥è¯¢è¶…è¿‡100ms - éœ€è¦å…³æ³¨
```

### 11.3 æ—¶é—´åˆ†å¸ƒå¯è§†åŒ–


**ASCIIå›¾è¡¨å±•ç¤º**ï¼š
```python
def display_time_distribution(data):
    """ASCIIå›¾è¡¨æ˜¾ç¤ºæ—¶é—´åˆ†å¸ƒ"""
    
    print("ğŸ“Š SQLæ‰§è¡Œæ—¶é—´åˆ†å¸ƒå›¾")
    print("=" * 60)
    
    max_count = max(row['query_count'] for row in data)
    
    for row in data:
        time_range = row['time_range']
        count = row['query_count'] 
        percentage = row['percentage']
        
        # è®¡ç®—æŸ±çŠ¶å›¾é•¿åº¦ï¼ˆæœ€å¤§50å­—ç¬¦ï¼‰
        bar_length = int((count / max_count) * 50)
        bar = 'â–ˆ' * bar_length
        
        # æ ¹æ®æ—¶é—´èŒƒå›´è®¾ç½®é¢œè‰²æ ‡è¯†
        if 'ms' in time_range and not any(x in time_range for x in ['500ms', '100-500ms']):
            status = 'ğŸŸ¢'  # ç»¿è‰² - å¿«é€Ÿ
        elif any(x in time_range for x in ['100-500ms', '500ms-1s']):
            status = 'ğŸŸ¡'  # é»„è‰² - ä¸­ç­‰
        else:
            status = 'ğŸ”´'  # çº¢è‰² - æ…¢é€Ÿ
            
        print(f"{status} {time_range:>10} â”‚{bar:<50}â”‚ {count:>4} ({percentage:>5.1f}%)")
    
    print("=" * 60)
    print("ğŸŸ¢ å¿«é€Ÿ (<100ms)  ğŸŸ¡ ä¸­ç­‰ (100ms-1s)  ğŸ”´ æ…¢é€Ÿ (>1s)")

# ä½¿ç”¨ç¤ºä¾‹
time_data = [
    {'time_range': '<1ms', 'query_count': 450, 'percentage': 45.0},
    {'time_range': '1-10ms', 'query_count': 320, 'percentage': 32.0},
    {'time_range': '10-100ms', 'query_count': 150, 'percentage': 15.0},
    {'time_range': '100-500ms', 'query_count': 60, 'percentage': 6.0},
    {'time_range': '500ms-1s', 'query_count': 15, 'percentage': 1.5},
    {'time_range': '1-5s', 'query_count': 4, 'percentage': 0.4},
    {'time_range': '>5s', 'query_count': 1, 'percentage': 0.1}
]

display_time_distribution(time_data)
```

### 11.4 æ—¶é—´åˆ†å¸ƒè¶‹åŠ¿ç›‘æ§


**æŒ‰æ—¶é—´æ®µå¯¹æ¯”åˆ†æ**ï¼š
```sql
-- å¯¹æ¯”ä¸åŒæ—¶é—´æ®µçš„æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ
WITH time_periods AS (
  SELECT 
    CASE 
      WHEN HOUR(FROM_UNIXTIME(first_seen/1000000000000)) BETWEEN 9 AND 18 THEN 'å·¥ä½œæ—¶é—´'
      WHEN HOUR(FROM_UNIXTIME(first_seen/1000000000000)) BETWEEN 19 AND 23 THEN 'æ™šé«˜å³°'
      ELSE 'å…¶ä»–æ—¶é—´'
    END AS period,
    CASE 
      WHEN avg_timer_wait/1000000000 < 0.1 THEN 'å¿«é€Ÿ(<100ms)'
      WHEN avg_timer_wait/1000000000 < 1.0 THEN 'ä¸­ç­‰(100ms-1s)'
      ELSE 'æ…¢é€Ÿ(>1s)'
    END AS speed_category,
    COUNT(*) AS query_count
  FROM performance_schema.events_statements_summary_by_digest
  WHERE count_star > 5
  GROUP BY period, speed_category
)
SELECT 
  period,
  speed_category,
  query_count,
  ROUND(query_count * 100.0 / SUM(query_count) OVER (PARTITION BY period), 2) AS percentage
FROM time_periods
ORDER BY period, 
  CASE speed_category 
    WHEN 'å¿«é€Ÿ(<100ms)' THEN 1
    WHEN 'ä¸­ç­‰(100ms-1s)' THEN 2  
    WHEN 'æ…¢é€Ÿ(>1s)' THEN 3
  END;
```

### 11.5 æ€§èƒ½åŸºå‡†è®¾å®š


**å¥åº·æŒ‡æ ‡å®šä¹‰**ï¼š
```python
# æ€§èƒ½å¥åº·åº¦è¯„ä¼°æ ‡å‡†
performance_standards = {
    'excellent': {
        'fast_queries_ratio': 0.85,      # 85%æŸ¥è¯¢<100ms
        'medium_queries_ratio': 0.13,    # 13%æŸ¥è¯¢100ms-1s
        'slow_queries_ratio': 0.02       # 2%æŸ¥è¯¢>1s
    },
    'good': {
        'fast_queries_ratio': 0.75,      # 75%æŸ¥è¯¢<100ms
        'medium_queries_ratio': 0.20,    # 20%æŸ¥è¯¢100ms-1s  
        'slow_queries_ratio': 0.05       # 5%æŸ¥è¯¢>1s
    },
    'warning': {
        'fast_queries_ratio': 0.60,      # 60%æŸ¥è¯¢<100ms
        'medium_queries_ratio': 0.30,    # 30%æŸ¥è¯¢100ms-1s
        'slow_queries_ratio': 0.10       # 10%æŸ¥è¯¢>1s
    }
}

def evaluate_performance_health(distribution_data):
    """è¯„ä¼°æ•°æ®åº“æ€§èƒ½å¥åº·åº¦"""
    
    # è®¡ç®—å„ç±»æŸ¥è¯¢æ¯”ä¾‹
    total_queries = sum(item['query_count'] for item in distribution_data)
    
    fast_count = sum(item['query_count'] for item in distribution_data 
                    if any(x in item['time_range'] for x in ['<1ms', '1-10ms', '10-100ms']))
    
    medium_count = sum(item['query_count'] for item in distribution_data
                      if any(x in item['time_range'] for x in ['100-500ms', '500ms-1s']))
    
    slow_count = sum(item['query_count'] for item in distribution_data
                    if any(x in item['time_range'] for x in ['1-5s', '>5s']))
    
    ratios = {
        'fast_queries_ratio': fast_count / total_queries,
        'medium_queries_ratio': medium_count / total_queries,
        'slow_queries_ratio': slow_count / total_queries
    }
    
    # è¯„ä¼°å¥åº·ç­‰çº§
    if (ratios['fast_queries_ratio'] >= performance_standards['excellent']['fast_queries_ratio'] and
        ratios['slow_queries_ratio'] <= performance_standards['excellent']['slow_queries_ratio']):
        health_level = 'excellent'
        health_icon = 'ğŸŸ¢'
        health_desc = 'ä¼˜ç§€'
    elif (ratios['fast_queries_ratio'] >= performance_standards['good']['fast_queries_ratio'] and
          ratios['slow_queries_ratio'] <= performance_standards['good']['slow_queries_ratio']):
        health_level = 'good'
        health_icon = 'ğŸŸ¡'
        health_desc = 'è‰¯å¥½'
    else:
        health_level = 'warning'
        health_icon = 'ğŸ”´'
        health_desc = 'éœ€è¦å…³æ³¨'
    
    return {
        'level': health_level,
        'icon': health_icon,
        'description': health_desc,
        'ratios': ratios,
        'recommendations': get_performance_recommendations(health_level, ratios)
    }

def get_performance_recommendations(health_level, ratios):
    """æ ¹æ®å¥åº·çŠ¶å†µç»™å‡ºå»ºè®®"""
    
    recommendations = []
    
    if health_level == 'warning':
        if ratios['slow_queries_ratio'] > 0.05:
            recommendations.append("ğŸ”§ å»ºè®®åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä¼˜åŒ–æ‰§è¡Œæ—¶é—´>1sçš„æŸ¥è¯¢")
        
        if ratios['fast_queries_ratio'] < 0.70:
            recommendations.append("ğŸ“Š å»ºè®®æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Œæé«˜å¿«é€ŸæŸ¥è¯¢æ¯”ä¾‹")
            
        recommendations.append("âš¡ å»ºè®®å¼€å¯æŸ¥è¯¢ç¼“å­˜æˆ–ä½¿ç”¨åº”ç”¨å±‚ç¼“å­˜")
        recommendations.append("ğŸ” å»ºè®®åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œä¼˜åŒ–æŸ¥è¯¢è·¯å¾„")
    
    elif health_level == 'good':
        recommendations.append("âœ… æ•´ä½“æ€§èƒ½è‰¯å¥½ï¼Œç»§ç»­ä¿æŒç°æœ‰ä¼˜åŒ–ç­–ç•¥")
        recommendations.append("ğŸ“ˆ å¯è€ƒè™‘è¿›ä¸€æ­¥ä¼˜åŒ–ä¸­ç­‰è€—æ—¶æŸ¥è¯¢")
    
    else:  # excellent
        recommendations.append("ğŸ‰ æ€§èƒ½è¡¨ç°ä¼˜ç§€ï¼")
        recommendations.append("ğŸ”„ å»ºè®®å»ºç«‹æ€§èƒ½åŸºçº¿ï¼ŒæŒç»­ç›‘æ§")
    
    return recommendations
```

### 11.6 å¼‚å¸¸æ£€æµ‹å’Œå‘Šè­¦


**æ—¶é—´åˆ†å¸ƒå¼‚å¸¸æ£€æµ‹**ï¼š
```python
def detect_time_distribution_anomaly(current_data, baseline_data, threshold=0.1):
    """æ£€æµ‹æ—¶é—´åˆ†å¸ƒå¼‚å¸¸"""
    
    anomalies = []
    
    for current_item in current_data:
        time_range = current_item['time_range']
        current_ratio = current_item['percentage'] / 100
        
        # æŸ¥æ‰¾åŸºçº¿æ•°æ®
        baseline_item = next((item for item in baseline_data 
                            if item['time_range'] == time_range), None)
        
        if baseline_item:
            baseline_ratio = baseline_item['percentage'] / 100
            ratio_change = abs(current_ratio - baseline_ratio)
            
            if ratio_change > threshold:
                anomaly_type = 'increase' if current_ratio > baseline_ratio else 'decrease'
                severity = 'high' if ratio_change > threshold * 2 else 'medium'
                
                anomalies.append({
                    'time_range': time_range,
                    'type': anomaly_type,
                    'severity': severity,
                    'current_ratio': current_ratio,
                    'baseline_ratio': baseline_ratio,
                    'change': ratio_change,
                    'description': f'{time_range}èŒƒå›´æŸ¥è¯¢æ¯”ä¾‹{anomaly_type}äº†{ratio_change:.1%}'
                })
    
    return anomalies

# å‘Šè­¦å¤„ç†
def handle_time_distribution_alert(anomalies):
    """å¤„ç†æ—¶é—´åˆ†å¸ƒå¼‚å¸¸å‘Šè­¦"""
    
    if not anomalies:
        return
    
    print("âš ï¸  SQLæ‰§è¡Œæ—¶é—´åˆ†å¸ƒå¼‚å¸¸å‘Šè­¦")
    print("=" * 50)
    
    for anomaly in anomalies:
        severity_icon = "ğŸ”´" if anomaly['severity'] == 'high' else "ğŸŸ¡"
        print(f"{severity_icon} {anomaly['description']}")
        print(f"   å½“å‰æ¯”ä¾‹: {anomaly['current_ratio']:.1%}")
        print(f"   åŸºçº¿æ¯”ä¾‹: {anomaly['baseline_ratio']:.1%}")
        print(f"   å˜åŒ–å¹…åº¦: {anomaly['change']:.1%}")
        print()
    
    # å‘é€å‘Šè­¦é€šçŸ¥ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€é’‰é’‰ç­‰ï¼‰
    send_alert_notification(anomalies)
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ…¢æŸ¥è¯¢åˆ†æï¼šè¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œlong_query_timeè®¾ç½®ï¼Œæ—¥å¿—åˆ†æå·¥å…·
ğŸ”¸ æ‰§è¡Œè®¡åˆ’è§£è¯»ï¼šEXPLAINè¾“å‡ºç†è§£ï¼Œtype/key/rows/Extraå­—æ®µå«ä¹‰
ğŸ”¸ ç´¢å¼•ä¼˜åŒ–ï¼šåˆ›å»ºç­–ç•¥ã€ç›‘æ§ä½¿ç”¨ã€ç»´æŠ¤æ›´æ–°ã€å¤åˆç´¢å¼•æœ€å·¦å‰ç¼€
ğŸ”¸ æŸ¥è¯¢é‡å†™ï¼šå­æŸ¥è¯¢è½¬JOINã€EXISTS vs INã€åˆ†é¡µä¼˜åŒ–æŠ€æœ¯
ğŸ”¸ SQLå®¡æ ¸ï¼šè‡ªåŠ¨åŒ–å·¥å…·ã€å®¡æ ¸æµç¨‹ã€ç¼–å†™è§„èŒƒã€é£é™©æ§åˆ¶
ğŸ”¸ æ€§èƒ½åŸºçº¿ï¼šæŒ‡æ ‡ä½“ç³»ã€æ•°æ®é‡‡é›†ã€åŸºçº¿ç®¡ç†ã€å¼‚å¸¸å‘Šè­¦
ğŸ”¸ å˜æ›´è¯„ä¼°ï¼šå½±å“åˆ†æã€å‰ç½®æ£€æŸ¥ã€æ‰§è¡Œç­–ç•¥ã€å›æ»šæ–¹æ¡ˆ
ğŸ”¸ æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼šå·¥ä½œåŸç†ã€ç»Ÿè®¡ä¿¡æ¯ã€Hintä½¿ç”¨ã€å‚æ•°è°ƒä¼˜
ğŸ”¸ æ‰§è¡Œç»Ÿè®¡ï¼šPerformance Schemaã€è¶‹åŠ¿åˆ†æã€æŠ¥å‘Šç”Ÿæˆ
ğŸ”¸ æ—¶é—´åˆ†å¸ƒï¼šåˆ†å¸ƒåˆ†æã€å¥åº·è¯„ä¼°ã€å¼‚å¸¸æ£€æµ‹ã€æ€§èƒ½ç›‘æ§
```

### 12.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¿ç»´æ€ç»´æ¨¡å¼**
```
é¢„é˜²ä¸ºä¸»ï¼š
- å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»
- åˆ¶å®šSQLç¼–å†™è§„èŒƒ
- å®æ–½å˜æ›´å®¡æ ¸æµç¨‹

å¿«é€Ÿå®šä½ï¼š
- æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ
- æ‰§è¡Œè®¡åˆ’è§£è¯»
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§

æŒç»­ä¼˜åŒ–ï¼š
- å®šæœŸæ€§èƒ½è¯„ä¼°
- ç´¢å¼•ä¼˜åŒ–è°ƒæ•´
- æŸ¥è¯¢é‡å†™æ”¹è¿›

åº”æ€¥å“åº”ï¼š
- å¿«é€Ÿå›æ»šæœºåˆ¶
- æ€§èƒ½æ•…éšœå¤„ç†
- å®¹é‡è§„åˆ’è°ƒæ•´
```

**ğŸ”¹ ä¼˜åŒ–ä¼˜å…ˆçº§ç­–ç•¥**
```
é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å¤„ç†ï¼‰ï¼š
- æ‰§è¡Œæ—¶é—´>5ç§’çš„æŸ¥è¯¢
- å…¨è¡¨æ‰«æçš„é¢‘ç¹æŸ¥è¯¢
- é€ æˆé”ç­‰å¾…çš„æ“ä½œ
- å½±å“ä¸šåŠ¡çš„æ€§èƒ½é—®é¢˜

ä¸­ä¼˜å…ˆçº§ï¼ˆè®¡åˆ’å¤„ç†ï¼‰ï¼š
- æ‰§è¡Œæ—¶é—´1-5ç§’çš„æŸ¥è¯¢
- ç´¢å¼•åˆ©ç”¨ç‡ä½çš„æŸ¥è¯¢
- ä¸´æ—¶è¡¨ä½¿ç”¨è¾ƒå¤šçš„æ“ä½œ
- æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ä½çš„åœºæ™¯

ä½ä¼˜å…ˆçº§ï¼ˆæŒç»­æ”¹è¿›ï¼‰ï¼š
- æ‰§è¡Œæ—¶é—´100ms-1sçš„æŸ¥è¯¢
- ä»£ç è§„èŒƒæ€§é—®é¢˜
- ç›‘æ§ä½“ç³»å®Œå–„
- æ–‡æ¡£å’Œæµç¨‹æ”¹è¿›
```

### 12.3 å®é™…åº”ç”¨æŒ‡å¯¼


**è¿ç»´å·¥ä½œæµç¨‹**ï¼š
```
æ—¥å¸¸å·¡æ£€ï¼š
1. æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—
2. æŸ¥çœ‹æ€§èƒ½ç›‘æ§æŒ‡æ ‡
3. åˆ†æSQLæ‰§è¡Œç»Ÿè®¡
4. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯

é—®é¢˜å¤„ç†ï¼š
1. å¿«é€Ÿå®šä½é—®é¢˜SQL
2. åˆ†ææ‰§è¡Œè®¡åˆ’
3. åˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ
4. æµ‹è¯•éªŒè¯æ•ˆæœ
5. ä¸Šçº¿å¹¶ç›‘æ§

å˜æ›´ç®¡ç†ï¼š
1. SQLå®¡æ ¸æ£€æŸ¥
2. å½±å“è¯„ä¼°åˆ†æ
3. åˆ¶å®šæ‰§è¡Œè®¡åˆ’
4. å‡†å¤‡å›æ»šæ–¹æ¡ˆ
5. åˆ†æ­¥å®‰å…¨æ‰§è¡Œ

æ€§èƒ½ä¼˜åŒ–ï¼š
1. å»ºç«‹æ€§èƒ½åŸºçº¿
2. è¯†åˆ«ä¼˜åŒ–ç›®æ ‡
3. å®æ–½ä¼˜åŒ–æªæ–½
4. éªŒè¯ä¼˜åŒ–æ•ˆæœ
5. æŒç»­ç›‘æ§æ”¹è¿›
```

**å·¥å…·ä½¿ç”¨å»ºè®®**ï¼š
```
å¿…å¤‡å·¥å…·ï¼š
âœ… mysqldumpslow - æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ
âœ… EXPLAIN/EXPLAIN ANALYZE - æ‰§è¡Œè®¡åˆ’åˆ†æ
âœ… Performance Schema - æ€§èƒ½ç»Ÿè®¡ç›‘æ§
âœ… pt-online-schema-change - åœ¨çº¿DDLå·¥å…·

æ¨èå·¥å…·ï¼š
âœ… Inception - SQLè‡ªåŠ¨å®¡æ ¸
âœ… ProxySQL - æŸ¥è¯¢è·¯ç”±å’Œç¼“å­˜
âœ… Prometheus + Grafana - ç›‘æ§å‘Šè­¦
âœ… pt-query-digest - æŸ¥è¯¢åˆ†æå·¥å…·

è‡ªå»ºå·¥å…·ï¼š
âœ… SQLæ‰§è¡Œç»Ÿè®¡åˆ†æè„šæœ¬
âœ… æ€§èƒ½åŸºçº¿ç›‘æ§ç³»ç»Ÿ
âœ… è‡ªåŠ¨åŒ–å·¡æ£€è„šæœ¬
âœ… å˜æ›´å½±å“è¯„ä¼°å·¥å…·
```

### 12.4 æœ€ä½³å®è·µæ€»ç»“


**æ ¸å¿ƒåŸåˆ™**ï¼š
- **ç›‘æ§ä¼˜å…ˆ**ï¼šå…ˆç›‘æ§ï¼Œåä¼˜åŒ–ï¼ŒåŸºäºæ•°æ®å†³ç­–
- **æ¸è¿›æ”¹è¿›**ï¼šå°æ­¥å¿«è·‘ï¼ŒæŒç»­ä¼˜åŒ–ï¼Œé¿å…å¤§æ”¹åŠ¨
- **é£é™©æ§åˆ¶**ï¼šå˜æ›´å‰è¯„ä¼°ï¼Œæ‰§è¡Œä¸­ç›‘æ§ï¼Œé—®é¢˜å¿«å›æ»š
- **æ–‡æ¡£è®°å½•**ï¼šä¼˜åŒ–è¿‡ç¨‹è®°å½•ï¼Œç»éªŒæ€»ç»“åˆ†äº«

**æˆåŠŸè¦ç´ **ï¼š
- **æŠ€æœ¯èƒ½åŠ›**ï¼šç†Ÿç»ƒæŒæ¡MySQLåŸç†å’Œå·¥å…·ä½¿ç”¨
- **ä¸šåŠ¡ç†è§£**ï¼šäº†è§£ä¸šåŠ¡åœºæ™¯ï¼Œåˆ¶å®šåˆé€‚ä¼˜åŒ–ç­–ç•¥
- **æµç¨‹è§„èŒƒ**ï¼šå»ºç«‹æ ‡å‡†åŒ–çš„è¿ç»´æµç¨‹å’Œè§„èŒƒ
- **å›¢é˜Ÿåä½œ**ï¼šä¸å¼€å‘ã€æµ‹è¯•ã€äº§å“ç­‰å›¢é˜Ÿå¯†åˆ‡é…åˆ

**é¿å…è¯¯åŒº**ï¼š
- âŒ è¿‡åº¦ä¼˜åŒ–ï¼šä¸è¦ä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ–
- âŒ ç›²ç›®è°ƒæ•´ï¼šå¿…é¡»åŸºäºç›‘æ§æ•°æ®å’Œåˆ†æç»“æœ
- âŒ å¿½è§†é£é™©ï¼šä»»ä½•å˜æ›´éƒ½è¦è€ƒè™‘æ½œåœ¨å½±å“
- âŒ å•å…µä½œæˆ˜ï¼šSQLä¼˜åŒ–éœ€è¦å›¢é˜Ÿåä½œ

**æ ¸å¿ƒè®°å¿†**ï¼š
- MySQLè¿ç»´é‡åœ¨é¢„é˜²ï¼Œç›‘æ§å…ˆè¡Œ
- æ…¢æŸ¥è¯¢åˆ†ææ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…¥å£
- æ‰§è¡Œè®¡åˆ’è§£è¯»æ˜¯é—®é¢˜å®šä½çš„å…³é”®
- å˜æ›´ç®¡ç†æ˜¯ç”Ÿäº§å®‰å…¨çš„ä¿éšœ
- æŒç»­ç›‘æ§æ˜¯æ€§èƒ½ç¨³å®šçš„åŸºç¡€