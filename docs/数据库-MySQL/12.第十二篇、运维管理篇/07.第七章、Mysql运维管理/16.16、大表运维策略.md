---
title: 16ã€å¤§è¡¨è¿ç»´ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [å¤§è¡¨å®šä¹‰ä¸è¯†åˆ«æ ‡å‡†](#1-å¤§è¡¨å®šä¹‰ä¸è¯†åˆ«æ ‡å‡†)
2. [å¤§è¡¨ç»´æŠ¤çª—å£è§„åˆ’](#2-å¤§è¡¨ç»´æŠ¤çª—å£è§„åˆ’)
3. [å¤§è¡¨åœ¨çº¿DDLç­–ç•¥](#3-å¤§è¡¨åœ¨çº¿ddlç­–ç•¥)
4. [å¤§è¡¨å¤‡ä»½æ¢å¤æ–¹æ¡ˆ](#4-å¤§è¡¨å¤‡ä»½æ¢å¤æ–¹æ¡ˆ)
5. [å¤§è¡¨æ€§èƒ½ä¼˜åŒ–ä¸“é¡¹](#5-å¤§è¡¨æ€§èƒ½ä¼˜åŒ–ä¸“é¡¹)
6. [å¤§è¡¨ç›‘æ§å‘Šè­¦ç­–ç•¥](#6-å¤§è¡¨ç›‘æ§å‘Šè­¦ç­–ç•¥)
7. [å¤§è¡¨å®¹é‡å¢é•¿é¢„æµ‹](#7-å¤§è¡¨å®¹é‡å¢é•¿é¢„æµ‹)
8. [TBçº§è¡¨è¿ç»´æœ€ä½³å®è·µ](#8-tbçº§è¡¨è¿ç»´æœ€ä½³å®è·µ)
9. [å¤§è¡¨åˆ†åŒºç­–ç•¥å®æ–½](#9-å¤§è¡¨åˆ†åŒºç­–ç•¥å®æ–½)
10. [å¤§è¡¨ç´¢å¼•ç»´æŠ¤ç­–ç•¥](#10-å¤§è¡¨ç´¢å¼•ç»´æŠ¤ç­–ç•¥)
11. [å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯æ›´æ–°](#11-å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯æ›´æ–°)
12. [å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–ä¸“é¡¹](#12-å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–ä¸“é¡¹)
13. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#13-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“Š å¤§è¡¨å®šä¹‰ä¸è¯†åˆ«æ ‡å‡†


### 1.1 ä»€ä¹ˆæ˜¯å¤§è¡¨


**é€šä¿—ç†è§£**ï¼šå¤§è¡¨å°±æ˜¯æ•°æ®é‡ç‰¹åˆ«å¤§çš„è¡¨ï¼Œä¼šç»™æ•°æ®åº“çš„æ—¥å¸¸è¿ç»´å¸¦æ¥æŒ‘æˆ˜ã€‚å°±åƒä¸€ä¸ªè£…æ»¡ä¸œè¥¿çš„å·¨å¤§ä»“åº“ï¼Œç®¡ç†èµ·æ¥æ¯”å°ä»“åº“è¦å›°éš¾å¾—å¤šã€‚

**å¤§è¡¨çš„æ ¸å¿ƒç‰¹å¾**ï¼š
- **æ•°æ®é‡åºå¤§**ï¼šè®°å½•æ•°è¶…è¿‡åƒä¸‡çº§åˆ«
- **å­˜å‚¨ç©ºé—´å¤§**ï¼šå ç”¨ç£ç›˜ç©ºé—´é€šå¸¸è¶…è¿‡GBç”šè‡³TBçº§åˆ«
- **æ“ä½œè€—æ—¶é•¿**ï¼šæŸ¥è¯¢ã€å¤‡ä»½ã€ç»´æŠ¤æ“ä½œæ˜æ˜¾å˜æ…¢
- **èµ„æºæ¶ˆè€—é«˜**ï¼šå¯¹CPUã€å†…å­˜ã€IOé€ æˆè¾ƒå¤§å‹åŠ›

### 1.2 å¤§è¡¨è¯†åˆ«æ ‡å‡†


```sql
-- å¿«é€Ÿè¯†åˆ«å¤§è¡¨çš„SQLæŸ¥è¯¢
SELECT 
    table_schema AS 'æ•°æ®åº“',
    table_name AS 'è¡¨å',
    table_rows AS 'è¡Œæ•°(ä¼°ç®—)',
    ROUND(data_length/1024/1024/1024, 2) AS 'æ•°æ®å¤§å°(GB)',
    ROUND(index_length/1024/1024/1024, 2) AS 'ç´¢å¼•å¤§å°(GB)',
    ROUND((data_length + index_length)/1024/1024/1024, 2) AS 'æ€»å¤§å°(GB)'
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
ORDER BY (data_length + index_length) DESC
LIMIT 20;
```

**å¤§è¡¨åˆ†çº§æ ‡å‡†**ï¼š

| çº§åˆ« | è¡Œæ•°èŒƒå›´ | å­˜å‚¨å¤§å° | ç‰¹ç‚¹è¯´æ˜ |
|------|---------|---------|---------|
| **ä¸­å‹è¡¨** | `100ä¸‡-1000ä¸‡` | `1GB-10GB` | å¼€å§‹éœ€è¦å…³æ³¨æ€§èƒ½ï¼Œç»´æŠ¤ç›¸å¯¹ç®€å• |
| **å¤§è¡¨** | `1000ä¸‡-1äº¿` | `10GB-100GB` | éœ€è¦ä¸“é—¨çš„è¿ç»´ç­–ç•¥ï¼Œæ“ä½œè¦è°¨æ… |
| **è¶…å¤§è¡¨** | `1äº¿-10äº¿` | `100GB-1TB` | å¿…é¡»ä½¿ç”¨åˆ†åŒºç­‰æŠ€æœ¯ï¼Œè¿ç»´å¤æ‚ |
| **å·¨å‹è¡¨** | `10äº¿ä»¥ä¸Š` | `1TBä»¥ä¸Š` | éœ€è¦åˆ†åº“åˆ†è¡¨ï¼Œä¸“ä¸šå›¢é˜Ÿç»´æŠ¤ |

### 1.3 å¤§è¡¨è¯†åˆ«çš„è‡ªåŠ¨åŒ–è„šæœ¬


```bash
#!/bin/bash
# å¤§è¡¨æ£€æµ‹è„šæœ¬ç¤ºä¾‹

mysql -u$USER -p$PASS -e "
SELECT 
    CONCAT(table_schema, '.', table_name) AS full_table_name,
    table_rows,
    ROUND((data_length + index_length)/1024/1024/1024, 2) AS size_gb,
    CASE 
        WHEN table_rows > 100000000 THEN 'å·¨å‹è¡¨'
        WHEN table_rows > 10000000 THEN 'è¶…å¤§è¡¨'
        WHEN table_rows > 1000000 THEN 'å¤§è¡¨'
        ELSE 'ä¸­å‹è¡¨'
    END AS table_level
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
    AND table_rows > 1000000
ORDER BY table_rows DESC;
" > large_tables_report.txt
```

### 1.4 å¤§è¡¨å½±å“åˆ†æ


**å¯¹ç³»ç»Ÿçš„ä¸»è¦å½±å“**ï¼š
- **ğŸ“ˆ æŸ¥è¯¢æ€§èƒ½**ï¼šå…¨è¡¨æ‰«æè€—æ—¶æ€¥å‰§å¢åŠ 
- **ğŸ”„ å¤‡ä»½æ—¶é—´**ï¼šå¤‡ä»½çª—å£å¯èƒ½ä¸å¤Ÿç”¨
- **âš¡ DDLæ“ä½œ**ï¼šåŠ ç´¢å¼•ã€æ”¹è¡¨ç»“æ„å˜å¾—éå¸¸æ…¢
- **ğŸ’¾ å­˜å‚¨å‹åŠ›**ï¼šç£ç›˜ç©ºé—´å¿«é€Ÿå¢é•¿
- **ğŸ”§ ç»´æŠ¤å¤æ‚**ï¼šæ—¥å¸¸è¿ç»´å·¥ä½œé‡å¤§å¹…å¢åŠ 

---

## 2. â° å¤§è¡¨ç»´æŠ¤çª—å£è§„åˆ’


### 2.1 ä»€ä¹ˆæ˜¯ç»´æŠ¤çª—å£


**é€šä¿—è§£é‡Š**ï¼šç»´æŠ¤çª—å£å°±æ˜¯ä¸“é—¨å®‰æ’çš„"åœæœºæ£€ä¿®æ—¶é—´"ï¼Œå°±åƒå•†åº—çš„"æ‰“çƒŠæ—¶é—´"ç”¨æ¥æ•´ç†è´§æ¶ã€‚åœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œå¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œä¸€äº›å¹³æ—¶ä¸æ•¢åšçš„é‡å¤§æ“ä½œã€‚

**ç»´æŠ¤çª—å£çš„ä½œç”¨**ï¼š
- **ğŸ› ï¸ æ‰§è¡Œé‡å‹æ“ä½œ**ï¼šå¦‚è¡¨ç»“æ„å˜æ›´ã€å¤§æ‰¹é‡æ•°æ®å¤„ç†
- **ğŸ“Š æ•°æ®åº“ä¼˜åŒ–**ï¼šé‡å»ºç´¢å¼•ã€æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
- **ğŸ”§ ç³»ç»Ÿç»´æŠ¤**ï¼šæœåŠ¡å™¨é‡å¯ã€ç³»ç»Ÿå‡çº§
- **ğŸ’¾ å®Œæ•´å¤‡ä»½**ï¼šè¿›è¡Œå…¨é‡å¤‡ä»½æ“ä½œ

### 2.2 ç»´æŠ¤çª—å£æ—¶é—´è§„åˆ’


```
å…¸å‹çš„ç»´æŠ¤çª—å£å®‰æ’ï¼š

ä¸šåŠ¡ç±»å‹        æœ€ä½³ç»´æŠ¤æ—¶é—´           çª—å£é•¿åº¦
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç”µå•†ç½‘ç«™        å‡Œæ™¨2:00-6:00         4å°æ—¶
åŠå…¬ç³»ç»Ÿ        å‘¨æœ«æ—©ä¸Š6:00-10:00     4å°æ—¶  
é‡‘èç³»ç»Ÿ        æ³•å®šèŠ‚å‡æ—¥å‡Œæ™¨         2-6å°æ—¶
å…¨çƒæœåŠ¡        å„åœ°åŒºæ·±å¤œè½®æµ         2å°æ—¶/åŒºåŸŸ
```

**ç»´æŠ¤çª—å£è§„åˆ’åŸåˆ™**ï¼š
- **ğŸ¯ é”™å³°å®‰æ’**ï¼šé¿å¼€ä¸šåŠ¡é«˜å³°æœŸ
- **â±ï¸ å……è¶³æ—¶é—´**ï¼šé¢„ç•™è¶³å¤Ÿçš„æ“ä½œå’Œå›æ»šæ—¶é—´
- **ğŸ“‹ æå‰é€šçŸ¥**ï¼šè‡³å°‘æå‰1å‘¨é€šçŸ¥ç›¸å…³äººå‘˜
- **ğŸ”„ åº”æ€¥é¢„æ¡ˆ**ï¼šå‡†å¤‡æ“ä½œå¤±è´¥çš„å›æ»šæ–¹æ¡ˆ

### 2.3 å¤§è¡¨ç»´æŠ¤çª—å£è®¡ç®—


```sql
-- é¢„ä¼°å¤§è¡¨æ“ä½œè€—æ—¶çš„å‚è€ƒå…¬å¼
-- DDLæ“ä½œæ—¶é—´ â‰ˆ è¡¨å¤§å°(GB) Ã— ç³»æ•°

-- ä¸åŒæ“ä½œçš„æ—¶é—´ç³»æ•°å‚è€ƒï¼š
-- æ·»åŠ ç´¢å¼•ï¼š5-15åˆ†é’Ÿ/GBï¼ˆå–å†³äºåˆ—çš„æ•°æ®ç‰¹å¾ï¼‰
-- åˆ é™¤åˆ—ï¼š1-3åˆ†é’Ÿ/GB
-- æ·»åŠ åˆ—ï¼š0.5-2åˆ†é’Ÿ/GB
-- è¡¨é‡å»ºï¼š10-30åˆ†é’Ÿ/GB

-- ç¤ºä¾‹ï¼š100GBçš„è¡¨æ·»åŠ ç´¢å¼•
-- é¢„ä¼°æ—¶é—´ï¼š100GB Ã— 10åˆ†é’Ÿ/GB = 1000åˆ†é’Ÿ â‰ˆ 16.7å°æ—¶
```

**ç»´æŠ¤çª—å£æ¨¡æ¿**ï¼š

```
å¤§è¡¨ç»´æŠ¤è®¡åˆ’æ¨¡æ¿
================

è¡¨ä¿¡æ¯ï¼š
- è¡¨åï¼šorders
- å¤§å°ï¼š500GB
- è¡Œæ•°ï¼š2äº¿æ¡

è®¡åˆ’æ“ä½œï¼š
- æ·»åŠ ç´¢å¼•ï¼šcustomer_id
- é¢„ä¼°è€—æ—¶ï¼š500GB Ã— 10åˆ†é’Ÿ/GB = 83å°æ—¶

ç»´æŠ¤çª—å£ï¼š
- å¼€å§‹æ—¶é—´ï¼š2024-01-15 02:00
- ç»“æŸæ—¶é—´ï¼š2024-01-17 02:00
- æ€»æ—¶é•¿ï¼š48å°æ—¶ï¼ˆåˆ†3ä¸ªçª—å£æ‰§è¡Œï¼‰

é£é™©è¯„ä¼°ï¼š
âœ… ä½é£é™©ï¼šæ·»åŠ ç´¢å¼•ä¸å½±å“æ•°æ®
âš ï¸ ä¸­é£é™©ï¼šé•¿æ—¶é—´é”è¡¨å¯èƒ½å½±å“ä¸šåŠ¡
âŒ é«˜é£é™©ï¼šæ“ä½œå¤±è´¥å¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨

å›æ»šæ–¹æ¡ˆï¼š
å¦‚æœæ“ä½œå¤±è´¥ï¼Œç«‹å³åœæ­¢å¹¶åˆ é™¤æœªå®Œæˆçš„ç´¢å¼•
```

---

## 3. ğŸ”§ å¤§è¡¨åœ¨çº¿DDLç­–ç•¥


### 3.1 ä»€ä¹ˆæ˜¯åœ¨çº¿DDL


**é€šä¿—ç†è§£**ï¼šåœ¨çº¿DDLå°±æ˜¯"ä¸åœæœºæ”¹è£…"ï¼Œå°±åƒåœ¨å•†åº—æ­£å¸¸è¥ä¸šçš„æ—¶å€™æ›´æ¢è´§æ¶ï¼Œæ—¢è¦ä¿è¯é¡¾å®¢èƒ½æ­£å¸¸è´­ç‰©ï¼Œåˆè¦å®Œæˆè´§æ¶çš„æ›´æ–°å·¥ä½œã€‚

**ä¼ ç»ŸDDLçš„é—®é¢˜**ï¼š
- **ğŸ”’ é•¿æ—¶é—´é”è¡¨**ï¼šæ•´ä¸ªæ“ä½œæœŸé—´è¡¨ä¸å¯ç”¨
- **â° ä¸šåŠ¡ä¸­æ–­**ï¼šç”¨æˆ·æ— æ³•æ­£å¸¸è®¿é—®
- **ğŸ’¥ é£é™©å¾ˆé«˜**ï¼šæ“ä½œå¤±è´¥å¯èƒ½å¯¼è‡´é•¿æ—¶é—´åœæœº

**åœ¨çº¿DDLçš„ä¼˜åŠ¿**ï¼š
- **ğŸ”„ ä¸šåŠ¡ä¸ä¸­æ–­**ï¼šæ“ä½œæœŸé—´è¡¨ä»å¯æ­£å¸¸ä½¿ç”¨
- **ğŸ“ˆ å¹¶å‘æ€§å¥½**ï¼šè¯»å†™æ“ä½œå¯ä»¥æ­£å¸¸è¿›è¡Œ
- **ğŸ›¡ï¸ é£é™©å¯æ§**ï¼šå¯ä»¥éšæ—¶åœæ­¢æ“ä½œ

### 3.2 MySQLåœ¨çº¿DDLæ”¯æŒæƒ…å†µ


```sql
-- MySQL 5.6+ æ”¯æŒçš„åœ¨çº¿DDLæ“ä½œ

-- âœ… æ”¯æŒåœ¨çº¿æ“ä½œï¼ˆä¸é”è¡¨ï¼‰ï¼š
ALTER TABLE big_table ADD INDEX idx_name (column_name);  -- æ·»åŠ ç´¢å¼•
ALTER TABLE big_table DROP INDEX idx_name;              -- åˆ é™¤ç´¢å¼•
ALTER TABLE big_table ADD COLUMN new_col INT;           -- æ·»åŠ åˆ—ï¼ˆè¡¨æœ«å°¾ï¼‰
ALTER TABLE big_table DROP COLUMN old_col;              -- åˆ é™¤åˆ—

-- âš ï¸ éƒ¨åˆ†æ”¯æŒï¼ˆçŸ­æš‚é”è¡¨ï¼‰ï¼š
ALTER TABLE big_table MODIFY COLUMN col_name VARCHAR(200); -- ä¿®æ”¹åˆ—å®šä¹‰
ALTER TABLE big_table CHANGE old_name new_name INT;        -- é‡å‘½ååˆ—

-- âŒ ä¸æ”¯æŒåœ¨çº¿æ“ä½œï¼ˆéœ€è¦é”è¡¨ï¼‰ï¼š
ALTER TABLE big_table ADD COLUMN new_col INT FIRST;        -- åœ¨å¼€å¤´æ·»åŠ åˆ—
ALTER TABLE big_table ADD PRIMARY KEY (id);                -- æ·»åŠ ä¸»é”®
```

### 3.3 åœ¨çº¿DDLçš„æ‰§è¡Œç­–ç•¥


**å‚æ•°ä¼˜åŒ–è®¾ç½®**ï¼š
```sql
-- åœ¨çº¿DDLç›¸å…³å‚æ•°è®¾ç½®
SET GLOBAL innodb_online_alter_log_max_size = 1024*1024*1024; -- 1GBæ—¥å¿—ç©ºé—´
SET SESSION lock_wait_timeout = 1;                           -- é™ä½é”ç­‰å¾…æ—¶é—´
SET SESSION innodb_lock_wait_timeout = 1;                    -- InnoDBé”ç­‰å¾…æ—¶é—´
```

**å®‰å…¨çš„åœ¨çº¿DDLæ‰§è¡Œæµç¨‹**ï¼š

```
Step 1: æ£€æŸ¥è¡¨çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SHOW PROCESSLIST;                    -- æ£€æŸ¥æ˜¯å¦æœ‰é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
SHOW ENGINE INNODB STATUS;           -- æ£€æŸ¥é”çŠ¶æ€

Step 2: è®¾ç½®å‚æ•°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SET SESSION lock_wait_timeout = 1;
SET SESSION innodb_lock_wait_timeout = 1;

Step 3: æ‰§è¡ŒDDL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ALTER TABLE big_table 
ADD INDEX idx_customer_id (customer_id), 
ALGORITHM=INPLACE, LOCK=NONE;

Step 4: ç›‘æ§è¿›åº¦
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- åœ¨å¦ä¸€ä¸ªsessionä¸­ç›‘æ§
SELECT * FROM information_schema.processlist 
WHERE command = 'Alter table';
```

### 3.4 ç¬¬ä¸‰æ–¹åœ¨çº¿DDLå·¥å…·


**pt-online-schema-change**ï¼ˆæ¨èï¼‰ï¼š
```bash
# ä½¿ç”¨pt-oscè¿›è¡Œå¤§è¡¨ç»“æ„å˜æ›´
pt-online-schema-change \
  --alter "ADD INDEX idx_customer_id (customer_id)" \
  --host=localhost \
  --user=admin \
  --password=pass \
  --database=ecommerce \
  --table=orders \
  --execute \
  --print \
  --statistics \
  --chunk-size=1000 \
  --max-load="Threads_running:50" \
  --critical-load="Threads_running:100"
```

**å·¥å…·å¯¹æ¯”**ï¼š

| å·¥å…· | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **MySQLåŸç”Ÿ** | ç®€å•ç›´æ¥ï¼Œæ€§èƒ½æœ€å¥½ | åŠŸèƒ½æœ‰é™ï¼Œé£é™©è¾ƒé«˜ | å°åˆ°ä¸­å‹è¡¨ï¼Œç®€å•æ“ä½œ |
| **pt-osc** | åŠŸèƒ½å¼ºå¤§ï¼Œå®‰å…¨æ€§é«˜ | éœ€è¦é¢å¤–å®‰è£…ï¼Œæ“ä½œå¤æ‚ | å¤§è¡¨ï¼Œå¤æ‚å˜æ›´ |
| **gh-ost** | GitHubå¼€æºï¼ŒæŒç»­æ”¹è¿› | ç›¸å¯¹è¾ƒæ–°ï¼Œç”Ÿæ€ä¸å¦‚pt-osc | å¯¹å®‰å…¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯ |

---

## 4. ğŸ’¾ å¤§è¡¨å¤‡ä»½æ¢å¤æ–¹æ¡ˆ


### 4.1 å¤§è¡¨å¤‡ä»½çš„æŒ‘æˆ˜


**é€šä¿—ç†è§£**ï¼šç»™å¤§è¡¨åšå¤‡ä»½å°±åƒæ¬å®¶æ—¶æ‰“åŒ…æ‰€æœ‰ç‰©å“ï¼Œä¸œè¥¿è¶Šå¤šï¼Œæ‰“åŒ…æ—¶é—´è¶Šé•¿ï¼Œè€Œä¸”ä¸­é€”ä¸èƒ½ä¸­æ–­ï¼Œå¦åˆ™å°±è¦é‡æ–°å¼€å§‹ã€‚

**ä¸»è¦æŒ‘æˆ˜**ï¼š
- **â° æ—¶é—´è¶…é•¿**ï¼šTBçº§è¡¨å¤‡ä»½å¯èƒ½éœ€è¦å‡ åä¸ªå°æ—¶
- **ğŸ’¾ ç©ºé—´éœ€æ±‚**ï¼šéœ€è¦é¢„ç•™è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´
- **ğŸ”„ ä¸€è‡´æ€§**ï¼šç¡®ä¿å¤‡ä»½æœŸé—´æ•°æ®çš„ä¸€è‡´æ€§
- **ğŸ“Š ä¸šåŠ¡å½±å“**ï¼šå¤‡ä»½è¿‡ç¨‹å¯èƒ½å½±å“ä¸šåŠ¡æ€§èƒ½

### 4.2 å¤§è¡¨å¤‡ä»½ç­–ç•¥é€‰æ‹©


**å®Œæ•´å¤‡ä»½ vs å¢é‡å¤‡ä»½**ï¼š

```
ç­–ç•¥å¯¹æ¯”å›¾ï¼š

å®Œæ•´å¤‡ä»½                    å¢é‡å¤‡ä»½
â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€
[========= å®Œæ•´æ•°æ® =========]   [=== åŸºç¡€ ===][+ å˜åŒ–1][+ å˜åŒ–2][+ å˜åŒ–3]
ä¼˜ç‚¹ï¼šæ¢å¤ç®€å•ï¼Œä¸€æ­¥åˆ°ä½      ä¼˜ç‚¹ï¼šå¤‡ä»½å¿«é€Ÿï¼Œå­˜å‚¨èŠ‚çœ
ç¼ºç‚¹ï¼šè€—æ—¶é•¿ï¼Œå ç”¨ç©ºé—´å¤§      ç¼ºç‚¹ï¼šæ¢å¤å¤æ‚ï¼Œéœ€è¦å¤šä¸ªæ–‡ä»¶

é€‚ç”¨ï¼šå‘¨æœ«ç»´æŠ¤çª—å£           é€‚ç”¨ï¼šæ—¥å¸¸è‡ªåŠ¨å¤‡ä»½
```

**é€»è¾‘å¤‡ä»½ vs ç‰©ç†å¤‡ä»½**ï¼š

| å¤‡ä»½ç±»å‹ | å·¥å…· | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|------|---------|
| **é€»è¾‘å¤‡ä»½** | `mysqldump` | è·¨å¹³å°ï¼Œå¯é€‰æ‹©æ€§å¤‡ä»½ | é€Ÿåº¦æ…¢ï¼Œå ç”¨CPUé«˜ | å°åˆ°ä¸­å‹è¡¨ï¼Œå¼€å‘ç¯å¢ƒ |
| **ç‰©ç†å¤‡ä»½** | `xtrabackup` | é€Ÿåº¦å¿«ï¼Œå½±å“å° | å¹³å°ç›¸å…³ï¼Œå…¨åº“å¤‡ä»½ | å¤§è¡¨ï¼Œç”Ÿäº§ç¯å¢ƒ |

### 4.3 å¤§è¡¨å¤‡ä»½å®è·µæ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šåˆ†åŒºè¡¨å¤‡ä»½**
```sql
-- å¦‚æœè¡¨å·²åˆ†åŒºï¼Œå¯ä»¥æŒ‰åˆ†åŒºå¤‡ä»½
-- ä¾‹ï¼šæŒ‰æœˆåˆ†åŒºçš„è®¢å•è¡¨

-- å¤‡ä»½å½“å‰æœˆåˆ†åŒº
mysqldump --single-transaction \
  --where="order_date >= '2024-01-01' AND order_date < '2024-02-01'" \
  ecommerce orders > orders_202401.sql

-- å¤‡ä»½å†å²åˆ†åŒºï¼ˆå‹ç¼©å­˜å‚¨ï¼‰
mysqldump --single-transaction \
  --where="order_date >= '2023-01-01' AND order_date < '2023-02-01'" \
  ecommerce orders | gzip > orders_202301.sql.gz
```

**æ–¹æ¡ˆäºŒï¼šå¹¶è¡Œå¤‡ä»½**
```bash
#!/bin/bash
# å¤§è¡¨å¹¶è¡Œå¤‡ä»½è„šæœ¬

TABLE_NAME="big_orders"
BACKUP_DIR="/backup/$(date +%Y%m%d)"
PARALLEL_JOBS=4

# è·å–è¡¨çš„æ€»è¡Œæ•°
TOTAL_ROWS=$(mysql -e "SELECT COUNT(*) FROM $TABLE_NAME" | tail -1)
ROWS_PER_JOB=$((TOTAL_ROWS / PARALLEL_JOBS))

# å¹¶è¡Œå¤‡ä»½
for i in $(seq 0 $((PARALLEL_JOBS-1))); do
    OFFSET=$((i * ROWS_PER_JOB))
    mysqldump --single-transaction \
      --where="id >= $OFFSET AND id < $((OFFSET + ROWS_PER_JOB))" \
      database $TABLE_NAME > "$BACKUP_DIR/${TABLE_NAME}_part_$i.sql" &
done

wait  # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
```

**æ–¹æ¡ˆä¸‰ï¼šXtraBackupå¤‡ä»½**
```bash
# ä½¿ç”¨XtraBackupè¿›è¡Œç‰©ç†å¤‡ä»½
xtrabackup --backup \
  --target-dir=/backup/full_backup_$(date +%Y%m%d) \
  --user=backup_user \
  --password=backup_pass \
  --parallel=4 \
  --compress \
  --compress-threads=4
```

### 4.4 å¤§è¡¨æ¢å¤ç­–ç•¥


**æ¢å¤æ—¶é—´ç›®æ ‡è§„åˆ’**ï¼š

```
RTO (æ¢å¤æ—¶é—´ç›®æ ‡) è§„åˆ’ï¼š

æ•°æ®é‡          å®Œæ•´æ¢å¤æ—¶é—´    å¢é‡æ¢å¤æ—¶é—´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
10GB           30åˆ†é’Ÿ         5åˆ†é’Ÿ
100GB          5å°æ—¶          30åˆ†é’Ÿ
1TB            2å¤©            4å°æ—¶
10TB           1-2å‘¨          1-2å¤©
```

**å¿«é€Ÿæ¢å¤æŠ€å·§**ï¼š
```sql
-- æ¢å¤æ—¶ä¼˜åŒ–å‚æ•°
SET GLOBAL innodb_buffer_pool_size = 8G;           -- å¢å¤§ç¼“å†²æ± 
SET GLOBAL innodb_log_file_size = 1G;              -- å¢å¤§æ—¥å¿—æ–‡ä»¶
SET GLOBAL innodb_flush_log_at_trx_commit = 2;     -- é™ä½åŒæ­¥è¦æ±‚
SET GLOBAL sync_binlog = 0;                        -- å…³é—­binlogåŒæ­¥

-- æ¢å¤å®Œæˆåæ¢å¤æ­£å¸¸å‚æ•°
SET GLOBAL innodb_flush_log_at_trx_commit = 1;
SET GLOBAL sync_binlog = 1;
```

---

## 5. ğŸš€ å¤§è¡¨æ€§èƒ½ä¼˜åŒ–ä¸“é¡¹


### 5.1 å¤§è¡¨æ€§èƒ½é—®é¢˜è¯Šæ–­


**é€šä¿—ç†è§£**ï¼šå¤§è¡¨æ€§èƒ½ä¼˜åŒ–å°±åƒç»™è¶…çº§å¸‚åœºé‡æ–°å¸ƒå±€ï¼Œç›®æ ‡æ˜¯è®©é¡¾å®¢èƒ½æ›´å¿«æ‰¾åˆ°æƒ³è¦çš„å•†å“ï¼Œå‡å°‘æ’é˜Ÿæ—¶é—´ã€‚

**å¸¸è§æ€§èƒ½é—®é¢˜**ï¼š
- **ğŸŒ æŸ¥è¯¢ç¼“æ…¢**ï¼šå…¨è¡¨æ‰«æå¯¼è‡´æŸ¥è¯¢æ—¶é—´è¿‡é•¿
- **ğŸ”’ é”ç­‰å¾…**ï¼šå¤§é‡å¹¶å‘å¯¼è‡´é”ç«äº‰æ¿€çƒˆ
- **ğŸ’¾ å†…å­˜ä¸è¶³**ï¼šè¡¨å¤ªå¤§æ— æ³•å®Œå…¨åŠ è½½åˆ°å†…å­˜
- **ğŸ“Š ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸ**ï¼šå¯¼è‡´ä¼˜åŒ–å™¨é€‰æ‹©é”™è¯¯çš„æ‰§è¡Œè®¡åˆ’

### 5.2 å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯


**åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–**ï¼š
```sql
-- âŒ ä¼ ç»Ÿåˆ†é¡µæ–¹å¼ï¼ˆæ·±åº¦åˆ†é¡µæ—¶å¾ˆæ…¢ï¼‰
SELECT * FROM big_table ORDER BY id LIMIT 1000000, 20;

-- âœ… æ¸¸æ ‡åˆ†é¡µæ–¹å¼ï¼ˆæ¨èï¼‰
SELECT * FROM big_table WHERE id > 1000000 ORDER BY id LIMIT 20;

-- âœ… è¦†ç›–ç´¢å¼•åˆ†é¡µï¼ˆé€‚ç”¨äºç®€å•æŸ¥è¯¢ï¼‰
SELECT id FROM big_table ORDER BY id LIMIT 1000000, 20;
```

**åˆ†åŒºè¡¨æŸ¥è¯¢ä¼˜åŒ–**ï¼š
```sql
-- âœ… åˆ©ç”¨åˆ†åŒºå‰ªæ
SELECT * FROM orders 
WHERE order_date >= '2024-01-01' 
  AND order_date < '2024-02-01'  -- åªæ‰«æ1æœˆåˆ†åŒº
  AND customer_id = 12345;

-- âŒ é¿å…è·¨åˆ†åŒºæŸ¥è¯¢
SELECT * FROM orders 
WHERE customer_id = 12345;  -- å¯èƒ½æ‰«ææ‰€æœ‰åˆ†åŒº
```

### 5.3 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥


**å¤§è¡¨ç´¢å¼•è®¾è®¡åŸåˆ™**ï¼š

```
ç´¢å¼•è®¾è®¡ä¼˜å…ˆçº§ï¼š

1. ä¸»é”®ç´¢å¼• (PRIMARY KEY)
   â”œâ”€ èšç°‡ç´¢å¼•ï¼Œæ•°æ®é¡µæŒ‰ä¸»é”®é¡ºåºå­˜å‚¨
   â””â”€ æŸ¥è¯¢æ•ˆç‡æœ€é«˜ï¼Œå¿…é¡»åˆç†è®¾è®¡

2. å”¯ä¸€ç´¢å¼• (UNIQUE KEY)  
   â”œâ”€ ä¿è¯æ•°æ®å”¯ä¸€æ€§
   â””â”€ æŸ¥è¯¢æ€§èƒ½ä»…æ¬¡äºä¸»é”®

3. ä¸šåŠ¡æŸ¥è¯¢ç´¢å¼•
   â”œâ”€ æ ¹æ®WHEREæ¡ä»¶åˆ›å»º
   â””â”€ è¦†ç›–80%ä»¥ä¸Šçš„æŸ¥è¯¢åœºæ™¯

4. ç»„åˆç´¢å¼•
   â”œâ”€ å¤šåˆ—ç»„åˆï¼Œéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™
   â””â”€ å‡å°‘ç´¢å¼•æ•°é‡ï¼Œæé«˜ç»´æŠ¤æ•ˆç‡
```

**ç´¢å¼•ç»´æŠ¤ç­–ç•¥**ï¼š
```sql
-- å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT 
    object_schema,
    object_name,
    index_name,
    count_read,
    count_read/count_fetch AS hit_ratio
FROM performance_schema.table_io_waits_summary_by_index_usage 
WHERE object_schema = 'your_database'
ORDER BY count_read DESC;

-- æ¸…ç†æœªä½¿ç”¨çš„ç´¢å¼•
-- (æ ¹æ®ä¸Šé¢æŸ¥è¯¢ç»“æœï¼Œcount_readä¸º0çš„ç´¢å¼•è€ƒè™‘åˆ é™¤)
```

### 5.4 æŸ¥è¯¢ç¼“å­˜ä¸è¿æ¥æ± ä¼˜åŒ–


**æŸ¥è¯¢ç¼“å­˜é…ç½®**ï¼š
```sql
-- MySQL 8.0 å·²ç§»é™¤æŸ¥è¯¢ç¼“å­˜ï¼Œå»ºè®®ä½¿ç”¨åº”ç”¨å±‚ç¼“å­˜
-- å¯¹äºè€ç‰ˆæœ¬MySQLï¼š
SET GLOBAL query_cache_size = 256M;
SET GLOBAL query_cache_type = ON;
```

**è¿æ¥æ± ä¼˜åŒ–**ï¼š
```sql
-- è¿æ¥ç›¸å…³å‚æ•°ä¼˜åŒ–
SET GLOBAL max_connections = 1000;              -- æœ€å¤§è¿æ¥æ•°
SET GLOBAL max_connect_errors = 999999;         -- è¿æ¥é”™è¯¯é™åˆ¶
SET GLOBAL connect_timeout = 10;                -- è¿æ¥è¶…æ—¶
SET GLOBAL wait_timeout = 3600;                 -- è¿æ¥ç©ºé—²è¶…æ—¶
SET GLOBAL interactive_timeout = 3600;          -- äº¤äº’å¼è¿æ¥è¶…æ—¶
```

---

## 6. ğŸ“Š å¤§è¡¨ç›‘æ§å‘Šè­¦ç­–ç•¥


### 6.1 å¤§è¡¨ç›‘æ§çš„é‡è¦æ€§


**é€šä¿—ç†è§£**ï¼šç›‘æ§å¤§è¡¨å°±åƒç»™é‡è¦è®¾å¤‡å®‰è£…ä»ªè¡¨ç›˜ï¼Œéšæ—¶è§‚å¯Ÿå„é¡¹æŒ‡æ ‡æ˜¯å¦æ­£å¸¸ï¼Œä¸€æ—¦å‘ç°å¼‚å¸¸å°±åŠæ—¶å¤„ç†ï¼Œé¿å…å°é—®é¢˜å˜æˆå¤§æ•…éšœã€‚

**ç›‘æ§çš„æ ¸å¿ƒç›®æ ‡**ï¼š
- **ğŸ” åŠæ—©å‘ç°é—®é¢˜**ï¼šåœ¨æ€§èƒ½æ¶åŒ–ä¹‹å‰é¢„è­¦
- **ğŸ“ˆ è·Ÿè¸ªå¢é•¿è¶‹åŠ¿**ï¼šé¢„æµ‹ä½•æ—¶éœ€è¦æ‰©å®¹
- **âš¡ ä¼˜åŒ–å†³ç­–æ”¯æŒ**ï¼šä¸ºæ€§èƒ½ä¼˜åŒ–æä¾›æ•°æ®ä¾æ®
- **ğŸ›¡ï¸ æ•…éšœå¿«é€Ÿå®šä½**ï¼šå‡ºç°é—®é¢˜æ—¶å¿«é€Ÿæ‰¾åˆ°æ ¹å› 

### 6.2 å¤§è¡¨å…³é”®ç›‘æ§æŒ‡æ ‡


**è¡¨çº§åˆ«ç›‘æ§æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ç±»åˆ« | ç›‘æ§é¡¹ç›® | æ­£å¸¸èŒƒå›´ | å‘Šè­¦é˜ˆå€¼ | ç›‘æ§SQLç¤ºä¾‹ |
|---------|---------|---------|---------|------------|
| **å®¹é‡æŒ‡æ ‡** | è¡¨å¤§å° | < 100GB | > 500GB | `SELECT table_schema, table_name, ROUND((data_length + index_length)/1024/1024/1024, 2) AS size_gb FROM information_schema.tables` |
| **å¢é•¿æŒ‡æ ‡** | æ—¥å¢é•¿é‡ | < 1GB/å¤© | > 10GB/å¤© | éœ€è¦å»ºç«‹å†å²æ•°æ®è¡¨è¿›è¡Œå¯¹æ¯” |
| **æ€§èƒ½æŒ‡æ ‡** | å¹³å‡æŸ¥è¯¢æ—¶é—´ | < 100ms | > 1s | `SELECT avg_timer_wait/1000000000 FROM performance_schema.table_io_waits_summary_by_table` |
| **å¹¶å‘æŒ‡æ ‡** | è¡¨é”ç­‰å¾… | < 10ä¸ª | > 100ä¸ª | `SHOW PROCESSLIST` ä¸­stateä¸ºlockedçš„æ•°é‡ |

**ç³»ç»Ÿçº§åˆ«ç›‘æ§æŒ‡æ ‡**ï¼š
```sql
-- å®æ—¶ç›‘æ§è„šæœ¬ç¤ºä¾‹
-- ç›‘æ§å¤§è¡¨çš„å®æ—¶æ€§èƒ½

-- 1. æŸ¥çœ‹å½“å‰é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
SELECT 
    id,
    user,
    host,
    db,
    command,
    time,
    state,
    LEFT(info, 100) as query_preview
FROM information_schema.processlist 
WHERE time > 30 AND command != 'Sleep'
ORDER BY time DESC;

-- 2. ç›‘æ§è¡¨çš„é”ç­‰å¾…æƒ…å†µ
SELECT 
    waiting_query,
    waiting_age,
    waiting_trx_id,
    blocking_query,
    blocking_age,
    blocking_trx_id
FROM sys.innodb_lock_waits;

-- 3. ç›‘æ§ç¼“å†²æ± å‘½ä¸­ç‡
SHOW GLOBAL STATUS LIKE 'Innodb_buffer_pool_read%';
```

### 6.3 å‘Šè­¦ç­–ç•¥è®¾è®¡


**åˆ†çº§å‘Šè­¦ä½“ç³»**ï¼š

```
å‘Šè­¦çº§åˆ«è®¾è®¡ï¼š

ğŸŸ¢ ä¿¡æ¯çº§ (INFO)
â”œâ”€ è§¦å‘æ¡ä»¶ï¼šè¡¨å¤§å°è¶…è¿‡é¢„è®¾é˜ˆå€¼çš„80%
â”œâ”€ å¤„ç†æ—¶é—´ï¼š1å‘¨å†…å¤„ç†
â””â”€ é€šçŸ¥æ–¹å¼ï¼šé‚®ä»¶é€šçŸ¥

ğŸŸ¡ è­¦å‘Šçº§ (WARNING)  
â”œâ”€ è§¦å‘æ¡ä»¶ï¼šæŸ¥è¯¢æ—¶é—´è¶…è¿‡1ç§’ï¼Œæˆ–è¡¨å¤§å°è¶…è¿‡é˜ˆå€¼
â”œâ”€ å¤„ç†æ—¶é—´ï¼š24å°æ—¶å†…å¤„ç†
â””â”€ é€šçŸ¥æ–¹å¼ï¼šé‚®ä»¶+çŸ­ä¿¡é€šçŸ¥

ğŸ”´ ç´§æ€¥çº§ (CRITICAL)
â”œâ”€ è§¦å‘æ¡ä»¶ï¼šå¤§é‡é”ç­‰å¾…ï¼Œæˆ–æŸ¥è¯¢æ—¶é—´è¶…è¿‡10ç§’
â”œâ”€ å¤„ç†æ—¶é—´ï¼šç«‹å³å¤„ç†
â””â”€ é€šçŸ¥æ–¹å¼ï¼šç”µè¯+çŸ­ä¿¡+é‚®ä»¶
```

**å‘Šè­¦è§„åˆ™é…ç½®ç¤ºä¾‹**ï¼š
```bash
# Prometheus + Grafana å‘Šè­¦è§„åˆ™ç¤ºä¾‹
groups:
- name: mysql_large_table
  rules:
  - alert: LargeTableSizeWarning
    expr: mysql_table_size_bytes > 100 * 1024 * 1024 * 1024  # 100GB
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "è¡¨ {{ $labels.table }} å¤§å°è¶…è¿‡100GB"
      
  - alert: LargeTableSlowQuery
    expr: mysql_slow_queries_total > 10
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "æ£€æµ‹åˆ°å¤§é‡æ…¢æŸ¥è¯¢"
```

### 6.4 è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬


**æ—¥å¸¸ç›‘æ§è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å¤§è¡¨æ—¥å¸¸ç›‘æ§è„šæœ¬

LOG_FILE="/var/log/mysql_large_table_monitor.log"
DATE=$(date '+%Y-%m-%d %H:%M:%S')

# æ£€æŸ¥å¤§è¡¨çŠ¶æ€
mysql -e "
SELECT 
    CONCAT('[$DATE] å¤§è¡¨æ£€æŸ¥: '),
    table_schema,
    table_name,
    ROUND((data_length + index_length)/1024/1024/1024, 2) AS size_gb,
    table_rows
FROM information_schema.tables 
WHERE (data_length + index_length) > 10*1024*1024*1024  -- å¤§äº10GB
ORDER BY (data_length + index_length) DESC;
" >> $LOG_FILE

# æ£€æŸ¥æ…¢æŸ¥è¯¢
SLOW_QUERIES=$(mysql -e "SHOW GLOBAL STATUS LIKE 'Slow_queries'" | awk 'NR==2{print $2}')
echo "[$DATE] æ…¢æŸ¥è¯¢æ•°é‡: $SLOW_QUERIES" >> $LOG_FILE

# æ£€æŸ¥è¿æ¥æ•°
CONNECTIONS=$(mysql -e "SHOW GLOBAL STATUS LIKE 'Threads_connected'" | awk 'NR==2{print $2}')
echo "[$DATE] å½“å‰è¿æ¥æ•°: $CONNECTIONS" >> $LOG_FILE
```

---

## 7. ğŸ“ˆ å¤§è¡¨å®¹é‡å¢é•¿é¢„æµ‹


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦å®¹é‡é¢„æµ‹


**é€šä¿—ç†è§£**ï¼šå®¹é‡é¢„æµ‹å°±åƒé¢„æŠ¥å¤©æ°”ï¼Œé€šè¿‡è§‚å¯Ÿå†å²æ•°æ®å’Œå½“å‰è¶‹åŠ¿ï¼Œé¢„æµ‹æœªæ¥çš„å­˜å‚¨éœ€æ±‚ï¼Œæå‰åšå¥½å‡†å¤‡ï¼Œé¿å…"ä¸´æ—¶æŠ±ä½›è„š"ã€‚

**å®¹é‡é¢„æµ‹çš„ä»·å€¼**ï¼š
- **ğŸ’° æˆæœ¬æ§åˆ¶**ï¼šæå‰è§„åˆ’ç¡¬ä»¶é‡‡è´­ï¼Œé¿å…ç´§æ€¥é‡‡è´­çš„é«˜æˆæœ¬
- **âš¡ æ€§èƒ½ä¿éšœ**ï¼šåœ¨æ€§èƒ½ä¸‹é™ä¹‹å‰å°±å¼€å§‹ä¼˜åŒ–
- **ğŸ›¡ï¸ é£é™©é¢„é˜²**ï¼šé¿å…å› å­˜å‚¨ä¸è¶³å¯¼è‡´çš„ç³»ç»Ÿæ•…éšœ
- **ğŸ“‹ å®¹é‡è§„åˆ’**ï¼šä¸ºåˆ†åº“åˆ†è¡¨ç­‰æ¶æ„è°ƒæ•´æä¾›ä¾æ®

### 7.2 æ•°æ®å¢é•¿æ¨¡å¼åˆ†æ


**å¸¸è§çš„æ•°æ®å¢é•¿æ¨¡å¼**ï¼š

```
å¢é•¿æ¨¡å¼åˆ†ç±»ï¼š

ğŸ“ˆ çº¿æ€§å¢é•¿
ç‰¹ç‚¹ï¼šæ¯å¤©å¢é•¿é‡åŸºæœ¬ç¨³å®š
ä¾‹å­ï¼šç”¨æˆ·ç­¾åˆ°è®°å½•è¡¨
é¢„æµ‹å…¬å¼ï¼šæœªæ¥å¤§å° = å½“å‰å¤§å° + æ—¥å¢é•¿é‡ Ã— å¤©æ•°

ğŸ“Š æŒ‡æ•°å¢é•¿  
ç‰¹ç‚¹ï¼šå¢é•¿é€Ÿåº¦è¶Šæ¥è¶Šå¿«
ä¾‹å­ï¼šç”¨æˆ·è¡Œä¸ºæ—¥å¿—è¡¨
é¢„æµ‹å…¬å¼ï¼šæœªæ¥å¤§å° = å½“å‰å¤§å° Ã— (1 + å¢é•¿ç‡)^å¤©æ•°

ğŸ”„ å‘¨æœŸæ€§å¢é•¿
ç‰¹ç‚¹ï¼šæŒ‰å­£èŠ‚æˆ–ä¸šåŠ¡å‘¨æœŸæ³¢åŠ¨
ä¾‹å­ï¼šç”µå•†è®¢å•è¡¨ï¼ˆåŒ11ã€618ç­‰ï¼‰
é¢„æµ‹æ–¹æ³•ï¼šåŸºäºå†å²å‘¨æœŸæ•°æ®å»ºæ¨¡

ğŸ¯ é˜¶æ¢¯å¼å¢é•¿
ç‰¹ç‚¹ï¼šæŸäº›æ—¶ç‚¹çªç„¶å¢é•¿ï¼Œç„¶åè¶‹äºå¹³ç¨³
ä¾‹å­ï¼šæ–°åŠŸèƒ½ä¸Šçº¿åçš„æ•°æ®è¡¨
é¢„æµ‹æ–¹æ³•ï¼šè¯†åˆ«å¢é•¿è§¦å‘äº‹ä»¶
```

### 7.3 å®¹é‡é¢„æµ‹å®æ–½æ–¹æ³•


**æ–¹æ³•ä¸€ï¼šåŸºäºå†å²æ•°æ®çš„çº¿æ€§é¢„æµ‹**
```sql
-- åˆ›å»ºè¡¨å¤§å°å†å²è®°å½•è¡¨
CREATE TABLE table_size_history (
    id INT PRIMARY KEY AUTO_INCREMENT,
    table_schema VARCHAR(64),
    table_name VARCHAR(64),
    size_gb DECIMAL(10,2),
    record_date DATE,
    INDEX idx_table_date (table_schema, table_name, record_date)
);

-- æ¯å¤©è®°å½•è¡¨å¤§å°ï¼ˆå®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼‰
INSERT INTO table_size_history (table_schema, table_name, size_gb, record_date)
SELECT 
    table_schema,
    table_name,
    ROUND((data_length + index_length)/1024/1024/1024, 2),
    CURDATE()
FROM information_schema.tables 
WHERE table_schema = 'your_database';

-- è®¡ç®—å¢é•¿è¶‹åŠ¿
SELECT 
    table_name,
    MAX(size_gb) as current_size,
    MIN(size_gb) as initial_size,
    (MAX(size_gb) - MIN(size_gb)) / DATEDIFF(MAX(record_date), MIN(record_date)) as daily_growth,
    -- é¢„æµ‹3ä¸ªæœˆåçš„å¤§å°
    MAX(size_gb) + ((MAX(size_gb) - MIN(size_gb)) / DATEDIFF(MAX(record_date), MIN(record_date))) * 90 as predicted_size_3m
FROM table_size_history 
WHERE record_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
GROUP BY table_name;
```

**æ–¹æ³•äºŒï¼šåŸºäºä¸šåŠ¡æŒ‡æ ‡çš„é¢„æµ‹**
```python
# Pythonè„šæœ¬ç¤ºä¾‹ï¼šåŸºäºä¸šåŠ¡å¢é•¿é¢„æµ‹è¡¨å®¹é‡
import pandas as pd
import numpy as np
from sklearn.linear_model import LinearRegression

# ä¸šåŠ¡æŒ‡æ ‡ä¸è¡¨å¤§å°çš„å…³ç³»å»ºæ¨¡
def predict_table_size(business_metrics, table_size_history):
    """
    åŸºäºä¸šåŠ¡æŒ‡æ ‡é¢„æµ‹è¡¨å®¹é‡
    business_metrics: æ—¥æ´»ç”¨æˆ·ã€è®¢å•é‡ç­‰ä¸šåŠ¡æŒ‡æ ‡
    table_size_history: å†å²è¡¨å¤§å°æ•°æ®
    """
    
    # å»ºç«‹å›å½’æ¨¡å‹
    model = LinearRegression()
    X = business_metrics[['daily_users', 'daily_orders']].values
    y = table_size_history['size_gb'].values
    
    model.fit(X, y)
    
    # é¢„æµ‹æœªæ¥å®¹é‡
    future_metrics = np.array([[50000, 10000]])  # é¢„æµ‹çš„ä¸šåŠ¡æŒ‡æ ‡
    predicted_size = model.predict(future_metrics)
    
    return predicted_size[0]
```

### 7.4 å®¹é‡é¢„è­¦é˜ˆå€¼è®¾ç½®


**é¢„è­¦é˜ˆå€¼è®¾è®¡**ï¼š

| é¢„è­¦çº§åˆ« | å‰©ä½™å®¹é‡ | é¢„è®¡ç”¨å®Œæ—¶é—´ | å¤„ç†æªæ–½ |
|---------|---------|-------------|---------|
| **ç»¿è‰²** | > 50% | > 6ä¸ªæœˆ | æ­£å¸¸ç›‘æ§ |
| **é»„è‰²** | 20-50% | 3-6ä¸ªæœˆ | å¼€å§‹è§„åˆ’æ‰©å®¹ |
| **æ©™è‰²** | 10-20% | 1-3ä¸ªæœˆ | å‡†å¤‡æ‰©å®¹æ–¹æ¡ˆ |
| **çº¢è‰²** | < 10% | < 1ä¸ªæœˆ | ç«‹å³æ‰§è¡Œæ‰©å®¹ |

**è‡ªåŠ¨åŒ–é¢„è­¦è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å®¹é‡é¢„è­¦è„šæœ¬

# è·å–å½“å‰è¡¨å¤§å°å’Œå¢é•¿ç‡
CURRENT_SIZE=$(mysql -e "SELECT ROUND(SUM(data_length + index_length)/1024/1024/1024, 2) FROM information_schema.tables WHERE table_schema='your_db'" | tail -1)

# è·å–30å¤©çš„å¹³å‡å¢é•¿é‡
GROWTH_RATE=$(mysql -e "
SELECT 
    ROUND(AVG(daily_growth), 2)
FROM (
    SELECT 
        table_name,
        (MAX(size_gb) - MIN(size_gb)) / DATEDIFF(MAX(record_date), MIN(record_date)) as daily_growth
    FROM table_size_history 
    WHERE record_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
    GROUP BY table_name
) t" | tail -1)

# è®¡ç®—é¢„è®¡ç”¨å®Œæ—¶é—´ï¼ˆå‡è®¾æ€»å®¹é‡1TBï¼‰
TOTAL_CAPACITY=1024  # 1TB
REMAINING_CAPACITY=$((TOTAL_CAPACITY - CURRENT_SIZE))
DAYS_LEFT=$((REMAINING_CAPACITY / GROWTH_RATE))

# å‘é€é¢„è­¦
if [ $DAYS_LEFT -lt 30 ]; then
    echo "ç´§æ€¥ï¼šå­˜å‚¨å®¹é‡é¢„è®¡${DAYS_LEFT}å¤©åç”¨å®Œ" | mail -s "å®¹é‡é¢„è­¦" admin@company.com
elif [ $DAYS_LEFT -lt 90 ]; then
    echo "è­¦å‘Šï¼šå­˜å‚¨å®¹é‡é¢„è®¡${DAYS_LEFT}å¤©åç”¨å®Œ" | mail -s "å®¹é‡æé†’" admin@company.com
fi
```

---

## 8. ğŸ—ï¸ TBçº§è¡¨è¿ç»´æœ€ä½³å®è·µ


### 8.1 TBçº§è¡¨çš„ç‰¹æ®ŠæŒ‘æˆ˜


**é€šä¿—ç†è§£**ï¼šTBçº§è¡¨å°±åƒç®¡ç†ä¸€ä¸ªè¶…å¤§å‹ä»“åº“ï¼Œé‡Œé¢æœ‰æ•°åäº¿ä»¶å•†å“ã€‚ä¼ ç»Ÿçš„ç®¡ç†æ–¹æ³•å®Œå…¨ä¸é€‚ç”¨ï¼Œå¿…é¡»é‡‡ç”¨å·¥ä¸šçº§çš„ç®¡ç†æ–¹å¼ã€‚

**TBçº§è¡¨é¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜**ï¼š
- **â° æ“ä½œè€—æ—¶æé•¿**ï¼šç®€å•çš„æ“ä½œå¯èƒ½éœ€è¦å‡ å¤©ç”šè‡³å‡ å‘¨
- **ğŸ’¾ å†…å­˜æ— æ³•å®¹çº³**ï¼šè¡¨çš„ç´¢å¼•éƒ½æ— æ³•å®Œå…¨åŠ è½½åˆ°å†…å­˜
- **ğŸ”’ é”å½±å“å·¨å¤§**ï¼šä»»ä½•é”è¡¨æ“ä½œéƒ½ä¼šä¸¥é‡å½±å“ä¸šåŠ¡
- **ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ç»´æŠ¤å›°éš¾**ï¼šå…¨è¡¨æ‰«æè·å–ç»Ÿè®¡ä¿¡æ¯ä¸ç°å®
- **ğŸ”„ å¤‡ä»½æ¢å¤å¤æ‚**ï¼šä¼ ç»Ÿå¤‡ä»½æ–¹å¼å®Œå…¨æ— æ³•åº”å¯¹

### 8.2 TBçº§è¡¨æ¶æ„è®¾è®¡åŸåˆ™


**åˆ†è€Œæ²»ä¹‹ç­–ç•¥**ï¼š

```
TBçº§è¡¨æ¶æ„è®¾è®¡ï¼š

åŸå§‹å¤§è¡¨ (10TB)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åˆ†åº“åˆ†è¡¨ç­–ç•¥        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DB1  â”‚ DB2  â”‚ DB3  â”‚ DB4 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚Table1â”‚Table1â”‚Table1â”‚Table1â”‚
â”‚Table2â”‚Table2â”‚Table2â”‚Table2â”‚
â”‚Table3â”‚Table3â”‚Table3â”‚Table3â”‚
â”‚Table4â”‚Table4â”‚Table4â”‚Table4â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ¯ä¸ªè¡¨: ~600GB (å¯ç®¡ç†å¤§å°)
```

**æ°´å¹³åˆ†è¡¨ç­–ç•¥**ï¼š
```sql
-- æŒ‰æ—¶é—´åˆ†è¡¨ï¼ˆæ¨èï¼‰
orders_202401, orders_202402, orders_202403...

-- æŒ‰å“ˆå¸Œåˆ†è¡¨
orders_0, orders_1, orders_2, orders_3...

-- æŒ‰ä¸šåŠ¡åˆ†è¡¨
orders_domestic, orders_international
```

### 8.3 TBçº§è¡¨åˆ†åŒºç­–ç•¥


**åˆ†åŒºç±»å‹é€‰æ‹©**ï¼š

| åˆ†åŒºç±»å‹ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---------|---------|------|------|
| **RANGEåˆ†åŒº** | æ—¶é—´åºåˆ—æ•°æ® | ä¾¿äºæ•°æ®æ¸…ç†ï¼ŒæŸ¥è¯¢é«˜æ•ˆ | æ•°æ®åˆ†å¸ƒå¯èƒ½ä¸å‡ |
| **HASHåˆ†åŒº** | å‡åŒ€åˆ†å¸ƒæ•°æ® | æ•°æ®åˆ†å¸ƒå‡åŒ€ | ä¸ä¾¿äºèŒƒå›´æŸ¥è¯¢ |
| **LISTåˆ†åŒº** | æŒ‰æšä¸¾å€¼åˆ†åŒº | ä¸šåŠ¡é€»è¾‘æ¸…æ™° | éœ€è¦é¢„å…ˆå®šä¹‰æ‰€æœ‰å€¼ |
| **KEYåˆ†åŒº** | å¤åˆä¸»é”®åœºæ™¯ | MySQLè‡ªåŠ¨è®¡ç®—åˆ†åŒº | ä¸å¦‚HASHå¯æ§ |

**åˆ†åŒºè¡¨åˆ›å»ºç¤ºä¾‹**ï¼š
```sql
-- åˆ›å»ºæŒ‰æœˆåˆ†åŒºçš„è®¢å•è¡¨
CREATE TABLE orders (
    order_id BIGINT NOT NULL,
    customer_id INT NOT NULL,
    order_date DATE NOT NULL,
    amount DECIMAL(10,2),
    status VARCHAR(20),
    PRIMARY KEY (order_id, order_date),
    KEY idx_customer (customer_id),
    KEY idx_date (order_date)
) ENGINE=InnoDB
PARTITION BY RANGE (YEAR(order_date) * 100 + MONTH(order_date)) (
    PARTITION p202401 VALUES LESS THAN (202402),
    PARTITION p202402 VALUES LESS THAN (202403),
    PARTITION p202403 VALUES LESS THAN (202404),
    PARTITION p202404 VALUES LESS THAN (202405),
    PARTITION p202405 VALUES LESS THAN (202406),
    PARTITION p202406 VALUES LESS THAN (202407),
    -- å¯ä»¥é€šè¿‡è„šæœ¬è‡ªåŠ¨æ·»åŠ æœªæ¥åˆ†åŒº
    PARTITION p999999 VALUES LESS THAN MAXVALUE
);
```

### 8.4 TBçº§è¡¨è¿ç»´è‡ªåŠ¨åŒ–


**è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†**ï¼š
```bash
#!/bin/bash
# è‡ªåŠ¨æ·»åŠ åˆ†åŒºè„šæœ¬

TABLE_NAME="orders"
CURRENT_MONTH=$(date +%Y%m)
NEXT_MONTH=$(date -d "next month" +%Y%m)

# æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ åˆ†åŒº
PARTITION_EXISTS=$(mysql -e "
SELECT COUNT(*) FROM information_schema.partitions 
WHERE table_name='$TABLE_NAME' 
AND partition_name='p$NEXT_MONTH'" | tail -1)

if [ $PARTITION_EXISTS -eq 0 ]; then
    # æ·»åŠ ä¸‹ä¸ªæœˆçš„åˆ†åŒº
    mysql -e "
    ALTER TABLE $TABLE_NAME 
    ADD PARTITION (PARTITION p$NEXT_MONTH VALUES LESS THAN ($((NEXT_MONTH + 1))));"
    
    echo "å·²æ·»åŠ åˆ†åŒº p$NEXT_MONTH"
fi

# åˆ é™¤è¿‡æœŸåˆ†åŒºï¼ˆä¿ç•™12ä¸ªæœˆæ•°æ®ï¼‰
OLD_MONTH=$(date -d "12 months ago" +%Y%m)
mysql -e "ALTER TABLE $TABLE_NAME DROP PARTITION p$OLD_MONTH;" 2>/dev/null
```

**æ€§èƒ½ç›‘æ§è‡ªåŠ¨åŒ–**ï¼š
```python
#!/usr/bin/env python3
# TBçº§è¡¨æ€§èƒ½ç›‘æ§è„šæœ¬

import mysql.connector
import time
import json

class TBTableMonitor:
    def __init__(self, host, user, password, database):
        self.conn = mysql.connector.connect(
            host=host, user=user, password=password, database=database
        )
        
    def monitor_table_performance(self, table_name):
        """ç›‘æ§TBçº§è¡¨çš„å…³é”®æ€§èƒ½æŒ‡æ ‡"""
        cursor = self.conn.cursor()
        
        # ç›‘æ§æŒ‡æ ‡
        metrics = {}
        
        # 1. è¡¨å¤§å°
        cursor.execute(f"""
            SELECT ROUND((data_length + index_length)/1024/1024/1024, 2) as size_gb
            FROM information_schema.tables 
            WHERE table_name = '{table_name}'
        """)
        metrics['size_gb'] = cursor.fetchone()[0]
        
        # 2. æ´»è·ƒè¿æ¥æ•°
        cursor.execute("SHOW PROCESSLIST")
        active_connections = len([row for row in cursor.fetchall() 
                                if row[3] == self.conn.database])
        metrics['active_connections'] = active_connections
        
        # 3. æ…¢æŸ¥è¯¢æ•°é‡
        cursor.execute("SHOW GLOBAL STATUS LIKE 'Slow_queries'")
        metrics['slow_queries'] = cursor.fetchone()[1]
        
        return metrics
        
    def generate_report(self, table_name):
        """ç”Ÿæˆç›‘æ§æŠ¥å‘Š"""
        metrics = self.monitor_table_performance(table_name)
        
        report = f"""
        TBçº§è¡¨ç›‘æ§æŠ¥å‘Š - {table_name}
        ===============================
        è¡¨å¤§å°: {metrics['size_gb']} GB
        æ´»è·ƒè¿æ¥: {metrics['active_connections']}
        æ…¢æŸ¥è¯¢æ•°: {metrics['slow_queries']}
        ç›‘æ§æ—¶é—´: {time.strftime('%Y-%m-%d %H:%M:%S')}
        """
        
        return report

# ä½¿ç”¨ç¤ºä¾‹
monitor = TBTableMonitor('localhost', 'user', 'pass', 'database')
print(monitor.generate_report('big_orders'))
```

---

## 9. ğŸ§© å¤§è¡¨åˆ†åŒºç­–ç•¥å®æ–½


### 9.1 åˆ†åŒºçš„åŸºæœ¬æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šåˆ†åŒºå°±åƒæŠŠä¸€ä¸ªå·¨å¤§çš„å›¾ä¹¦é¦†æŒ‰ç…§ä¸åŒç±»åˆ«åˆ†æˆè‹¥å¹²ä¸ªç‹¬ç«‹çš„é˜…è§ˆå®¤ï¼Œæ¯ä¸ªé˜…è§ˆå®¤ä¸“é—¨å­˜æ”¾ç‰¹å®šç±»å‹çš„ä¹¦ç±ï¼Œè¿™æ ·æ‰¾ä¹¦å°±ä¼šå¿«å¾ˆå¤šã€‚

**åˆ†åŒºçš„å·¥ä½œåŸç†**ï¼š
- **ğŸ“š é€»è¾‘ç»Ÿä¸€**ï¼šå¯¹åº”ç”¨æ¥è¯´ä»ç„¶æ˜¯ä¸€å¼ è¡¨
- **ğŸ  ç‰©ç†åˆ†ç¦»**ï¼šåº•å±‚æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­
- **ğŸ¯ æ™ºèƒ½è·¯ç”±**ï¼šMySQLè‡ªåŠ¨æ ¹æ®åˆ†åŒºé”®é€‰æ‹©æ­£ç¡®çš„åˆ†åŒº
- **âš¡ å¹¶è¡Œå¤„ç†**ï¼šå¯ä»¥å¹¶è¡Œæ“ä½œä¸åŒçš„åˆ†åŒº

### 9.2 åˆ†åŒºç­–ç•¥é€‰æ‹©æŒ‡å—


**é€‰æ‹©åˆ†åŒºç­–ç•¥çš„å†³ç­–æ ‘**ï¼š

```
åˆ†åŒºç­–ç•¥é€‰æ‹©å†³ç­–æ ‘ï¼š

æ•°æ®æœ‰æ—¶é—´å±æ€§ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ•°æ®æœ‰æ˜æ˜¾å†·çƒ­åˆ†å¸ƒï¼Ÿ
â”‚   â”œâ”€ æ˜¯ â†’ RANGEåˆ†åŒºï¼ˆæŒ‰æ—¶é—´ï¼‰
â”‚   â””â”€ å¦ â†’ è€ƒè™‘å…¶ä»–ç­–ç•¥
â””â”€ å¦ â†’ æ•°æ®éœ€è¦å‡åŒ€åˆ†å¸ƒï¼Ÿ
    â”œâ”€ æ˜¯ â†’ HASHåˆ†åŒº
    â””â”€ å¦ â†’ æœ‰æ˜ç¡®çš„åˆ†ç±»å­—æ®µï¼Ÿ
        â”œâ”€ æ˜¯ â†’ LISTåˆ†åŒº
        â””â”€ å¦ â†’ ä¸å»ºè®®åˆ†åŒº
```

**å®é™…ä¸šåŠ¡åœºæ™¯ä¸¾ä¾‹**ï¼š

| ä¸šåŠ¡åœºæ™¯ | æ¨èåˆ†åŒºç­–ç•¥ | åˆ†åŒºé”® | ç†ç”± |
|---------|-------------|--------|------|
| **è®¢å•è¡¨** | RANGEæŒ‰æœˆåˆ†åŒº | `order_date` | æŸ¥è¯¢å¤šä¸ºæ—¶é—´èŒƒå›´ï¼Œå†å²æ•°æ®å¯å½’æ¡£ |
| **æ—¥å¿—è¡¨** | RANGEæŒ‰å¤©åˆ†åŒº | `create_time` | æ•°æ®é‡å¤§ï¼Œéœ€è¦å®šæœŸæ¸…ç†å†å²æ•°æ® |
| **ç”¨æˆ·è¡¨** | HASHåˆ†åŒº | `user_id` | æ•°æ®åˆ†å¸ƒå‡åŒ€ï¼Œæ— æ˜æ˜¾æ—¶é—´ç‰¹å¾ |
| **åœ°åŒºæ•°æ®** | LISTåˆ†åŒº | `region_code` | æŒ‰åœ°åŒºæŸ¥è¯¢ï¼Œåœ°åŒºæ•°é‡æœ‰é™ä¸”å›ºå®š |

### 9.3 åˆ†åŒºè¡¨å®æ–½æ­¥éª¤


**Step 1: ç°æœ‰è¡¨åˆ†åŒºæ”¹é€ **
```sql
-- æ³¨æ„ï¼šç°æœ‰è¡¨æ”¹é€ ä¸ºåˆ†åŒºè¡¨éœ€è¦é‡å»ºï¼Œå»ºè®®åœ¨ç»´æŠ¤çª—å£æ‰§è¡Œ

-- 1. åˆ›å»ºä¸´æ—¶åˆ†åŒºè¡¨
CREATE TABLE orders_partitioned (
    order_id BIGINT NOT NULL,
    customer_id INT NOT NULL,
    order_date DATE NOT NULL,
    amount DECIMAL(10,2),
    status VARCHAR(20),
    PRIMARY KEY (order_id, order_date),  -- åˆ†åŒºé”®å¿…é¡»åŒ…å«åœ¨ä¸»é”®ä¸­
    KEY idx_customer (customer_id)
) ENGINE=InnoDB
PARTITION BY RANGE (YEAR(order_date) * 100 + MONTH(order_date)) (
    PARTITION p202401 VALUES LESS THAN (202402),
    PARTITION p202402 VALUES LESS THAN (202403),
    PARTITION p202403 VALUES LESS THAN (202404),
    PARTITION p999999 VALUES LESS THAN MAXVALUE
);

-- 2. æ•°æ®è¿ç§»ï¼ˆå¯ä»¥åˆ†æ‰¹è¿›è¡Œï¼‰
INSERT INTO orders_partitioned 
SELECT * FROM orders 
WHERE order_date >= '2024-01-01' AND order_date < '2024-02-01';

-- 3. è¡¨ååˆ‡æ¢ï¼ˆåœ¨ç»´æŠ¤çª—å£æ‰§è¡Œï¼‰
RENAME TABLE orders TO orders_backup, orders_partitioned TO orders;
```

**Step 2: åˆ†åŒºç»´æŠ¤è‡ªåŠ¨åŒ–**
```bash
#!/bin/bash
# åˆ†åŒºç»´æŠ¤è„šæœ¬

MYSQL_CMD="mysql -u admin -p'password' database_name"

# å‡½æ•°ï¼šæ·»åŠ æœªæ¥åˆ†åŒº
add_future_partitions() {
    local table_name=$1
    local months_ahead=$2
    
    for i in $(seq 1 $months_ahead); do
        next_month=$(date -d "+$i month" +%Y%m)
        next_month_value=$((next_month + 1))
        
        # æ£€æŸ¥åˆ†åŒºæ˜¯å¦å·²å­˜åœ¨
        partition_exists=$($MYSQL_CMD -e "
            SELECT COUNT(*) FROM information_schema.partitions 
            WHERE table_name='$table_name' AND partition_name='p$next_month'
        " | tail -1)
        
        if [ $partition_exists -eq 0 ]; then
            echo "æ·»åŠ åˆ†åŒº p$next_month"
            $MYSQL_CMD -e "
                ALTER TABLE $table_name 
                ADD PARTITION (PARTITION p$next_month VALUES LESS THAN ($next_month_value))
            "
        fi
    done
}

# å‡½æ•°ï¼šæ¸…ç†å†å²åˆ†åŒº
cleanup_old_partitions() {
    local table_name=$1
    local keep_months=$2
    
    old_month=$(date -d "-$keep_months month" +%Y%m)
    
    echo "æ¸…ç†åˆ†åŒº p$old_month"
    $MYSQL_CMD -e "ALTER TABLE $table_name DROP PARTITION IF EXISTS p$old_month"
}

# æ‰§è¡Œç»´æŠ¤
add_future_partitions "orders" 6      # æ·»åŠ æœªæ¥6ä¸ªæœˆçš„åˆ†åŒº
cleanup_old_partitions "orders" 24    # ä¿ç•™24ä¸ªæœˆçš„å†å²æ•°æ®
```

### 9.4 åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–


**åˆ†åŒºå‰ªæä¼˜åŒ–**ï¼š
```sql
-- âœ… åˆ©ç”¨åˆ†åŒºå‰ªæçš„æŸ¥è¯¢ï¼ˆåªæ‰«æç›¸å…³åˆ†åŒºï¼‰
SELECT * FROM orders 
WHERE order_date >= '2024-01-01' 
  AND order_date < '2024-02-01'
  AND customer_id = 12345;

-- âŒ æ— æ³•åˆ©ç”¨åˆ†åŒºå‰ªæçš„æŸ¥è¯¢ï¼ˆæ‰«ææ‰€æœ‰åˆ†åŒºï¼‰
SELECT * FROM orders 
WHERE customer_id = 12345;  -- æ²¡æœ‰åˆ†åŒºé”®æ¡ä»¶

-- æŸ¥çœ‹æŸ¥è¯¢çš„åˆ†åŒºä½¿ç”¨æƒ…å†µ
EXPLAIN PARTITIONS 
SELECT * FROM orders 
WHERE order_date >= '2024-01-01' AND order_date < '2024-02-01';
```

**åˆ†åŒºè¡¨ç´¢å¼•ç­–ç•¥**ï¼š
```sql
-- åˆ†åŒºè¡¨çš„ç´¢å¼•è®¾è®¡åŸåˆ™ï¼š

-- 1. ä¸»é”®å¿…é¡»åŒ…å«åˆ†åŒºé”®
ALTER TABLE orders ADD PRIMARY KEY (order_id, order_date);

-- 2. å”¯ä¸€é”®å¿…é¡»åŒ…å«åˆ†åŒºé”®
ALTER TABLE orders ADD UNIQUE KEY uk_order_no (order_no, order_date);

-- 3. æ™®é€šç´¢å¼•å¯ä»¥ä¸åŒ…å«åˆ†åŒºé”®
ALTER TABLE orders ADD INDEX idx_customer (customer_id);

-- 4. å¤åˆç´¢å¼•ä¼˜åŒ–
ALTER TABLE orders ADD INDEX idx_customer_date (customer_id, order_date);
```

**åˆ†åŒºè¡¨ç»Ÿè®¡ä¿¡æ¯ç»´æŠ¤**ï¼š
```sql
-- æ‰‹åŠ¨æ›´æ–°åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE orders PARTITION (p202401, p202402);

-- æŸ¥çœ‹åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
SELECT 
    partition_name,
    table_rows,
    avg_row_length,
    data_length,
    index_length
FROM information_schema.partitions 
WHERE table_name = 'orders' 
ORDER BY partition_ordinal_position;
```

---

## 10. ğŸ”§ å¤§è¡¨ç´¢å¼•ç»´æŠ¤ç­–ç•¥


### 10.1 å¤§è¡¨ç´¢å¼•ç»´æŠ¤çš„é‡è¦æ€§


**é€šä¿—ç†è§£**ï¼šç´¢å¼•å°±åƒä¹¦ç±çš„ç›®å½•ï¼Œå¯¹äºå¤§è¡¨æ¥è¯´ï¼Œç»´æŠ¤å¥½ç´¢å¼•å°±åƒç»´æŠ¤ä¸€ä¸ªè¶…å¤§å›¾ä¹¦é¦†çš„ç´¢å¼•ç³»ç»Ÿï¼Œä¸€æ—¦ç´¢å¼•å‡ºé—®é¢˜ï¼Œæ‰¾ä¹¦ï¼ˆæŸ¥æ•°æ®ï¼‰å°±ä¼šå˜å¾—æå…¶å›°éš¾ã€‚

**å¤§è¡¨ç´¢å¼•é¢ä¸´çš„æŒ‘æˆ˜**ï¼š
- **ğŸ”„ ç»´æŠ¤æˆæœ¬é«˜**ï¼šæ¯æ¬¡æ•°æ®å˜æ›´éƒ½è¦æ›´æ–°ç´¢å¼•
- **ğŸ’¾ ç©ºé—´å ç”¨å¤§**ï¼šç´¢å¼•å¯èƒ½æ¯”æ•°æ®æœ¬èº«è¿˜å¤§
- **â° é‡å»ºè€—æ—¶é•¿**ï¼šé‡å»ºç´¢å¼•å¯èƒ½éœ€è¦å‡ åä¸ªå°æ—¶
- **ğŸ”’ ç»´æŠ¤å½±å“ä¸šåŠ¡**ï¼šç´¢å¼•ç»´æŠ¤æœŸé—´å¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½

### 10.2 ç´¢å¼•å¥åº·çŠ¶æ€æ£€æŸ¥


**ç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æ**ï¼š
```sql
-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡
SELECT 
    object_schema AS database_name,
    object_name AS table_name,
    index_name,
    count_read,
    count_write,
    count_fetch,
    count_insert,
    count_update,
    count_delete
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'your_database'
ORDER BY count_read + count_write DESC;

-- æ‰¾å‡ºä»æœªä½¿ç”¨çš„ç´¢å¼•
SELECT 
    object_schema,
    object_name,
    index_name
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'your_database'
  AND count_read = 0 
  AND count_write = 0
  AND index_name IS NOT NULL
  AND index_name != 'PRIMARY';
```

**ç´¢å¼•ç¢ç‰‡æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥ç´¢å¼•ç¢ç‰‡ç‡
SELECT 
    database_name,
    table_name,
    index_name,
    stat_value AS pages,
    stat_value * $$innodb_page_size / 1024 / 1024 AS size_mb
FROM mysql.innodb_index_stats 
WHERE stat_name = 'size' 
  AND database_name = 'your_database'
ORDER BY stat_value DESC;

-- æ£€æŸ¥è¡¨çš„ç¢ç‰‡æƒ…å†µ
SELECT 
    table_schema,
    table_name,
    ROUND(data_length/1024/1024, 2) AS data_mb,
    ROUND(data_free/1024/1024, 2) AS free_mb,
    ROUND(data_free/(data_length + data_free) * 100, 2) AS fragmentation_percent
FROM information_schema.tables
WHERE table_schema = 'your_database'
  AND data_free > 0
ORDER BY fragmentation_percent DESC;
```

### 10.3 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥


**ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ**ï¼š

```
ç´¢å¼•è®¾è®¡åŸåˆ™ä¼˜å…ˆçº§ï¼š

1. ä¸»é”®ç´¢å¼• (æœ€é«˜ä¼˜å…ˆçº§)
   â”œâ”€ ä½¿ç”¨è‡ªå¢IDä½œä¸ºä¸»é”®
   â”œâ”€ é¿å…ä½¿ç”¨UUIDç­‰éšæœºå€¼
   â””â”€ ä¸»é”®é•¿åº¦å°½é‡çŸ­

2. å”¯ä¸€ç´¢å¼•
   â”œâ”€ ä¸šåŠ¡å”¯ä¸€å­—æ®µå»ºç«‹å”¯ä¸€ç´¢å¼•
   â”œâ”€ é˜²æ­¢é‡å¤æ•°æ®
   â””â”€ æŸ¥è¯¢æ€§èƒ½ä»…æ¬¡äºä¸»é”®

3. ä¸šåŠ¡æŸ¥è¯¢ç´¢å¼•
   â”œâ”€ è¦†ç›–80%ä»¥ä¸Šçš„æŸ¥è¯¢
   â”œâ”€ éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™
   â””â”€ é€‰æ‹©æ€§é«˜çš„åˆ—æ”¾åœ¨å‰é¢

4. è¦†ç›–ç´¢å¼•
   â”œâ”€ åŒ…å«æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—
   â”œâ”€ é¿å…å›è¡¨æŸ¥è¯¢
   â””â”€ æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½
```

**å¤åˆç´¢å¼•è®¾è®¡æŠ€å·§**ï¼š
```sql
-- âœ… å¥½çš„å¤åˆç´¢å¼•è®¾è®¡
-- æŸ¥è¯¢ï¼šWHERE status = 'active' AND create_time > '2024-01-01' ORDER BY create_time
CREATE INDEX idx_status_time ON orders (status, create_time);

-- âœ… è¦†ç›–ç´¢å¼•è®¾è®¡
-- æŸ¥è¯¢ï¼šSELECT order_id, amount FROM orders WHERE customer_id = 123
CREATE INDEX idx_customer_cover ON orders (customer_id, order_id, amount);

-- âŒ ä¸å¥½çš„ç´¢å¼•è®¾è®¡
CREATE INDEX idx_time_status ON orders (create_time, status);  -- é¡ºåºé”™è¯¯
CREATE INDEX idx_amount ON orders (amount);  -- é€‰æ‹©æ€§å·®çš„åˆ—ä¸é€‚åˆå•ç‹¬å»ºç´¢å¼•
```

### 10.4 å¤§è¡¨ç´¢å¼•ç»´æŠ¤å®è·µ


**åœ¨çº¿ç´¢å¼•é‡å»º**ï¼š
```sql
-- MySQL 8.0 æ”¯æŒåœ¨çº¿ç´¢å¼•é‡å»º
ALTER TABLE large_table DROP INDEX idx_old, ALGORITHM=INPLACE, LOCK=NONE;
ALTER TABLE large_table ADD INDEX idx_new (column1, column2), ALGORITHM=INPLACE, LOCK=NONE;

-- å¯¹äºæ›´å¤§çš„è¡¨ï¼Œä½¿ç”¨pt-online-schema-change
-- pt-online-schema-change \
--   --alter "ADD INDEX idx_customer_date (customer_id, order_date)" \
--   --host=localhost --user=admin --password=pass \
--   D=database_name,t=large_table --execute
```

**åˆ†æ‰¹ç´¢å¼•ç»´æŠ¤**ï¼š
```bash
#!/bin/bash
# å¤§è¡¨ç´¢å¼•ç»´æŠ¤è„šæœ¬

TABLE_NAME="large_orders"
BATCH_SIZE=100000

# è·å–è¡¨çš„æ€»è¡Œæ•°
TOTAL_ROWS=$(mysql -e "SELECT COUNT(*) FROM $TABLE_NAME" | tail -1)
BATCHES=$((TOTAL_ROWS / BATCH_SIZE + 1))

echo "å¼€å§‹åˆ†æ‰¹é‡å»ºç´¢å¼•ï¼Œæ€»è®¡ $BATCHES æ‰¹æ¬¡"

for i in $(seq 1 $BATCHES); do
    OFFSET=$(((i-1) * BATCH_SIZE))
    
    echo "å¤„ç†ç¬¬ $i æ‰¹æ¬¡ï¼Œåç§»é‡: $OFFSET"
    
    # åˆ†æ‰¹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    mysql -e "
        ANALYZE TABLE $TABLE_NAME UPDATE HISTOGRAM ON customer_id, order_date 
        WITH 100 BUCKETS;
    "
    
    # æ¯æ‰¹æ¬¡å¤„ç†åä¼‘æ¯ä¸€æ®µæ—¶é—´ï¼Œé¿å…å½±å“ä¸šåŠ¡
    sleep 10
done

echo "ç´¢å¼•ç»´æŠ¤å®Œæˆ"
```

**ç´¢å¼•ç›‘æ§å‘Šè­¦**ï¼š
```python
#!/usr/bin/env python3
# ç´¢å¼•æ€§èƒ½ç›‘æ§è„šæœ¬

import mysql.connector
import smtplib
from email.mime.text import MIMEText

class IndexMonitor:
    def __init__(self, db_config):
        self.conn = mysql.connector.connect(**db_config)
        
    def check_unused_indexes(self):
        """æ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼•"""
        cursor = self.conn.cursor()
        cursor.execute("""
            SELECT 
                object_schema,
                object_name,
                index_name,
                ROUND((SELECT ROUND(SUM(data_length + index_length)/1024/1024, 2)
                       FROM information_schema.tables t 
                       WHERE t.table_schema = object_schema 
                       AND t.table_name = object_name), 2) AS table_size_mb
            FROM performance_schema.table_io_waits_summary_by_index_usage
            WHERE object_schema NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
              AND count_read = 0 
              AND count_write = 0
              AND index_name IS NOT NULL
              AND index_name != 'PRIMARY'
        """)
        
        unused_indexes = cursor.fetchall()
        return unused_indexes
        
    def check_duplicate_indexes(self):
        """æ£€æŸ¥é‡å¤ç´¢å¼•"""
        cursor = self.conn.cursor()
        cursor.execute("""
            SELECT 
                table_schema,
                table_name,
                GROUP_CONCAT(index_name) AS duplicate_indexes,
                column_names
            FROM (
                SELECT 
                    table_schema,
                    table_name,
                    index_name,
                    GROUP_CONCAT(column_name ORDER BY seq_in_index) AS column_names
                FROM information_schema.statistics
                WHERE table_schema NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
                GROUP BY table_schema, table_name, index_name
            ) t
            GROUP BY table_schema, table_name, column_names
            HAVING COUNT(*) > 1
        """)
        
        duplicate_indexes = cursor.fetchall()
        return duplicate_indexes
        
    def send_alert(self, message):
        """å‘é€å‘Šè­¦é‚®ä»¶"""
        msg = MIMEText(message)
        msg['Subject'] = 'MySQLç´¢å¼•ç›‘æ§å‘Šè­¦'
        msg['From'] = 'monitor@company.com'
        msg['To'] = 'dba@company.com'
        
        # å‘é€é‚®ä»¶é€»è¾‘
        print(f"å‘Šè­¦ä¿¡æ¯: {message}")

# ä½¿ç”¨ç¤ºä¾‹
db_config = {
    'host': 'localhost',
    'user': 'monitor',
    'password': 'password',
    'database': 'your_database'
}

monitor = IndexMonitor(db_config)
unused = monitor.check_unused_indexes()
duplicates = monitor.check_duplicate_indexes()

if unused:
    monitor.send_alert(f"å‘ç° {len(unused)} ä¸ªæœªä½¿ç”¨çš„ç´¢å¼•")
    
if duplicates:
    monitor.send_alert(f"å‘ç° {len(duplicates)} ç»„é‡å¤ç´¢å¼•")
```

---

## 11. ğŸ“Š å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯æ›´æ–°


### 11.1 ç»Ÿè®¡ä¿¡æ¯çš„é‡è¦æ€§


**é€šä¿—ç†è§£**ï¼šç»Ÿè®¡ä¿¡æ¯å°±åƒåœ°å›¾ä¸Šçš„è·¯å†µä¿¡æ¯ï¼ŒMySQLä¼˜åŒ–å™¨æ ¹æ®è¿™äº›ä¿¡æ¯æ¥é€‰æ‹©æœ€ä½³çš„æŸ¥è¯¢è·¯å¾„ã€‚å¦‚æœç»Ÿè®¡ä¿¡æ¯è¿‡æœŸäº†ï¼Œå°±åƒä½¿ç”¨äº†è¿‡æ—¶çš„è·¯å†µä¿¡æ¯ï¼Œå¯èƒ½ä¼šé€‰æ‹©æ‹¥å µçš„è·¯çº¿ã€‚

**ç»Ÿè®¡ä¿¡æ¯çš„ä½œç”¨**ï¼š
- **ğŸ¯ æŸ¥è¯¢ä¼˜åŒ–**ï¼šå¸®åŠ©ä¼˜åŒ–å™¨é€‰æ‹©æœ€ä½³æ‰§è¡Œè®¡åˆ’
- **ğŸ“Š æˆæœ¬ä¼°ç®—**ï¼šä¼°ç®—ä¸åŒæŸ¥è¯¢è·¯å¾„çš„æˆæœ¬
- **ğŸ” ç´¢å¼•é€‰æ‹©**ï¼šå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•æˆ–æ˜¯å¦å…¨è¡¨æ‰«æ
- **ğŸ”„ Joiné¡ºåº**ï¼šåœ¨å¤šè¡¨è¿æ¥ä¸­ç¡®å®šæœ€ä¼˜çš„joiné¡ºåº

### 11.2 ç»Ÿè®¡ä¿¡æ¯ç±»å‹è¯¦è§£


**MySQLä¸­çš„ç»Ÿè®¡ä¿¡æ¯åˆ†ç±»**ï¼š

| ç»Ÿè®¡ä¿¡æ¯ç±»å‹ | å­˜å‚¨ä½ç½® | æ›´æ–°æ–¹å¼ | ä½œç”¨è¯´æ˜ |
|-------------|---------|---------|---------|
| **è¡¨çº§ç»Ÿè®¡** | `information_schema.tables` | è‡ªåŠ¨/æ‰‹åŠ¨ | è¡¨å¤§å°ã€è¡Œæ•°ä¼°ç®— |
| **ç´¢å¼•ç»Ÿè®¡** | `mysql.innodb_index_stats` | è‡ªåŠ¨/æ‰‹åŠ¨ | ç´¢å¼•é€‰æ‹©æ€§ã€åˆ†å¸ƒæƒ…å†µ |
| **åˆ—ç»Ÿè®¡** | `information_schema.column_statistics` | æ‰‹åŠ¨ | åˆ—å€¼åˆ†å¸ƒç›´æ–¹å›¾ |
| **å¼•æ“ç»Ÿè®¡** | `performance_schema` | å®æ—¶ | æŸ¥è¯¢æ‰§è¡Œç»Ÿè®¡ |

**æŸ¥çœ‹å½“å‰ç»Ÿè®¡ä¿¡æ¯**ï¼š
```sql
-- æŸ¥çœ‹è¡¨çš„åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯
SELECT 
    table_name,
    table_rows,
    avg_row_length,
    data_length,
    index_length,
    update_time
FROM information_schema.tables 
WHERE table_schema = 'your_database'
ORDER BY table_rows DESC;

-- æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
SELECT 
    database_name,
    table_name,
    index_name,
    stat_name,
    stat_value,
    stat_description
FROM mysql.innodb_index_stats 
WHERE database_name = 'your_database'
  AND table_name = 'large_table'
ORDER BY table_name, index_name, stat_name;

-- æŸ¥çœ‹åˆ—çš„ç›´æ–¹å›¾ç»Ÿè®¡
SELECT 
    schema_name,
    table_name,
    column_name,
    JSON_PRETTY(histogram)
FROM information_schema.column_statistics
WHERE schema_name = 'your_database';
```

### 11.3 å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯æ›´æ–°ç­–ç•¥


**è‡ªåŠ¨ vs æ‰‹åŠ¨æ›´æ–°ç­–ç•¥**ï¼š

```
ç»Ÿè®¡ä¿¡æ¯æ›´æ–°ç­–ç•¥ï¼š

è‡ªåŠ¨æ›´æ–° (innodb_stats_auto_recalc=ON)
â”œâ”€ ä¼˜ç‚¹ï¼šæ— éœ€äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨ä¿æŒæœ€æ–°
â”œâ”€ ç¼ºç‚¹ï¼šå¤§è¡¨æ›´æ–°å¯èƒ½å½±å“æ€§èƒ½
â””â”€ é€‚ç”¨ï¼šä¸­å°å‹è¡¨ï¼Œä¸šåŠ¡å½±å“å¯æ§

æ‰‹åŠ¨æ›´æ–° (æ¨èç”¨äºå¤§è¡¨)
â”œâ”€ ä¼˜ç‚¹ï¼šå¯æ§çš„æ›´æ–°æ—¶æœºï¼Œå‡å°‘ä¸šåŠ¡å½±å“
â”œâ”€ ç¼ºç‚¹ï¼šéœ€è¦å®šæœŸç»´æŠ¤ï¼Œå¯èƒ½é—æ¼
â””â”€ é€‚ç”¨ï¼šå¤§è¡¨ï¼Œå¯¹æ€§èƒ½æ•æ„Ÿçš„ä¸šåŠ¡
```

**å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯æ›´æ–°æœ€ä½³å®è·µ**ï¼š
```sql
-- 1. å…³é—­è‡ªåŠ¨ç»Ÿè®¡æ›´æ–°ï¼ˆé’ˆå¯¹å¤§è¡¨ï¼‰
ALTER TABLE large_orders STATS_AUTO_RECALC=0;

-- 2. æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE large_orders;

-- 3. é‡‡æ ·æ›´æ–°ï¼ˆå‡å°‘æ‰«ææ•°æ®é‡ï¼‰
ANALYZE TABLE large_orders UPDATE HISTOGRAM ON customer_id, order_date WITH 100 BUCKETS;

-- 4. æŸ¥çœ‹æ›´æ–°è¿›åº¦ï¼ˆå¦ä¸€ä¸ªsessionï¼‰
SHOW PROCESSLIST;
```

**åˆ†åŒºè¡¨ç»Ÿè®¡ä¿¡æ¯ç»´æŠ¤**ï¼š
```sql
-- åªæ›´æ–°æŒ‡å®šåˆ†åŒºçš„ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE orders PARTITION (p202401, p202402);

-- æ›´æ–°æ‰€æœ‰åˆ†åŒº
ANALYZE TABLE orders;

-- æŸ¥çœ‹å„åˆ†åŒºçš„ç»Ÿè®¡ä¿¡æ¯
SELECT 
    partition_name,
    table_rows,
    avg_row_length,
    data_length
FROM information_schema.partitions 
WHERE table_schema = 'your_database' 
  AND table_name = 'orders'
  AND partition_name IS NOT NULL
ORDER BY partition_ordinal_position;
```

### 11.4 ç»Ÿè®¡ä¿¡æ¯æ›´æ–°è‡ªåŠ¨åŒ–


**å®šæ—¶æ›´æ–°è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯å®šæ—¶æ›´æ–°è„šæœ¬

MYSQL_CMD="mysql -u admin -p'password' database_name"
LOG_FILE="/var/log/mysql_stats_update.log"

# è·å–éœ€è¦æ›´æ–°ç»Ÿè®¡ä¿¡æ¯çš„å¤§è¡¨åˆ—è¡¨
LARGE_TABLES=$($MYSQL_CMD -e "
    SELECT table_name 
    FROM information_schema.tables 
    WHERE table_schema = 'your_database'
      AND (data_length + index_length) > 1024*1024*1024  -- å¤§äº1GBçš„è¡¨
      AND (update_time IS NULL OR update_time < DATE_SUB(NOW(), INTERVAL 7 DAY))
" | tail -n +2)

echo "$(date): å¼€å§‹æ›´æ–°å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯" >> $LOG_FILE

for table in $LARGE_TABLES; do
    echo "$(date): æ›´æ–°è¡¨ $table çš„ç»Ÿè®¡ä¿¡æ¯" >> $LOG_FILE
    
    # æ£€æŸ¥è¡¨æ˜¯å¦æœ‰æ´»è·ƒæŸ¥è¯¢
    ACTIVE_QUERIES=$($MYSQL_CMD -e "
        SELECT COUNT(*) FROM information_schema.processlist 
        WHERE db = 'your_database' 
          AND info LIKE '%$table%' 
          AND command != 'Sleep'
    " | tail -1)
    
    if [ $ACTIVE_QUERIES -gt 0 ]; then
        echo "$(date): è¡¨ $table æœ‰æ´»è·ƒæŸ¥è¯¢ï¼Œè·³è¿‡æ›´æ–°" >> $LOG_FILE
        continue
    fi
    
    # æ‰§è¡Œç»Ÿè®¡ä¿¡æ¯æ›´æ–°
    start_time=$(date +%s)
    $MYSQL_CMD -e "ANALYZE TABLE $table" >> $LOG_FILE 2>&1
    end_time=$(date +%s)
    
    duration=$((end_time - start_time))
    echo "$(date): è¡¨ $table ç»Ÿè®¡ä¿¡æ¯æ›´æ–°å®Œæˆï¼Œè€—æ—¶ $duration ç§’" >> $LOG_FILE
    
    # æ›´æ–°é—´éš”ï¼Œé¿å…å¯¹ç³»ç»Ÿé€ æˆè¿‡å¤§å‹åŠ›
    sleep 300  # ä¼‘æ¯5åˆ†é’Ÿ
done

echo "$(date): å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯æ›´æ–°ä»»åŠ¡å®Œæˆ" >> $LOG_FILE
```

**æ™ºèƒ½æ›´æ–°ç­–ç•¥**ï¼š
```python
#!/usr/bin/env python3
# æ™ºèƒ½ç»Ÿè®¡ä¿¡æ¯æ›´æ–°è„šæœ¬

import mysql.connector
import time
from datetime import datetime, timedelta

class StatsUpdater:
    def __init__(self, db_config):
        self.conn = mysql.connector.connect(**db_config)
        
    def should_update_stats(self, table_name):
        """åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ç»Ÿè®¡ä¿¡æ¯"""
        cursor = self.conn.cursor()
        
        # æ£€æŸ¥è¡¨çš„æ›´æ–°é¢‘ç‡
        cursor.execute(f"""
            SELECT 
                table_rows,
                update_time,
                (data_length + index_length) / 1024 / 1024 / 1024 AS size_gb
            FROM information_schema.tables 
            WHERE table_schema = DATABASE() AND table_name = '{table_name}'
        """)
        
        result = cursor.fetchone()
        if not result:
            return False
            
        table_rows, update_time, size_gb = result
        
        # æ›´æ–°æ¡ä»¶ï¼š
        # 1. è¶…è¿‡7å¤©æœªæ›´æ–°
        # 2. è¡¨å¤§å°è¶…è¿‡10GBä¸”è¶…è¿‡3å¤©æœªæ›´æ–°
        # 3. ç»Ÿè®¡ä¿¡æ¯ä»æœªæ›´æ–°è¿‡
        
        if update_time is None:
            return True
            
        days_since_update = (datetime.now() - update_time).days
        
        if size_gb > 10 and days_since_update > 3:
            return True
        elif days_since_update > 7:
            return True
            
        return False
        
    def update_table_stats(self, table_name):
        """æ›´æ–°æŒ‡å®šè¡¨çš„ç»Ÿè®¡ä¿¡æ¯"""
        cursor = self.conn.cursor()
        
        print(f"å¼€å§‹æ›´æ–°è¡¨ {table_name} çš„ç»Ÿè®¡ä¿¡æ¯...")
        start_time = time.time()
        
        try:
            # å…ˆæ›´æ–°è¡¨ç»Ÿè®¡
            cursor.execute(f"ANALYZE TABLE {table_name}")
            
            # å†æ›´æ–°ç›´æ–¹å›¾ï¼ˆä¸»è¦åˆ—ï¼‰
            cursor.execute(f"""
                SELECT column_name 
                FROM information_schema.columns 
                WHERE table_schema = DATABASE() 
                  AND table_name = '{table_name}'
                  AND column_name IN ('id', 'customer_id', 'order_date', 'status')
            """)
            
            columns = [row[0] for row in cursor.fetchall()]
            
            if columns:
                columns_str = ', '.join(columns)
                cursor.execute(f"ANALYZE TABLE {table_name} UPDATE HISTOGRAM ON {columns_str} WITH 100 BUCKETS")
            
            end_time = time.time()
            duration = round(end_time - start_time, 2)
            
            print(f"è¡¨ {table_name} ç»Ÿè®¡ä¿¡æ¯æ›´æ–°å®Œæˆï¼Œè€—æ—¶ {duration} ç§’")
            return True
            
        except Exception as e:
            print(f"æ›´æ–°è¡¨ {table_name} ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: {e}")
            return False
            
    def run_maintenance(self):
        """æ‰§è¡Œç»´æŠ¤ä»»åŠ¡"""
        cursor = self.conn.cursor()
        
        # è·å–æ‰€æœ‰å¤§è¡¨
        cursor.execute("""
            SELECT table_name 
            FROM information_schema.tables 
            WHERE table_schema = DATABASE()
              AND (data_length + index_length) > 100*1024*1024  -- å¤§äº100MB
            ORDER BY (data_length + index_length) DESC
        """)
        
        tables = [row[0] for row in cursor.fetchall()]
        
        updated_count = 0
        for table in tables:
            if self.should_update_stats(table):
                if self.update_table_stats(table):
                    updated_count += 1
                    # æ›´æ–°é—´éš”
                    time.sleep(60)
                    
        print(f"ç»´æŠ¤å®Œæˆï¼Œå…±æ›´æ–° {updated_count} ä¸ªè¡¨çš„ç»Ÿè®¡ä¿¡æ¯")

# ä½¿ç”¨ç¤ºä¾‹
db_config = {
    'host': 'localhost',
    'user': 'admin',
    'password': 'password',
    'database': 'your_database'
}

updater = StatsUpdater(db_config)
updater.run_maintenance()
```

---

## 12. ğŸ¯ å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–ä¸“é¡¹


### 12.1 å¤§è¡¨æŸ¥è¯¢æ€§èƒ½é—®é¢˜åˆ†æ


**é€šä¿—ç†è§£**ï¼šå¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–å°±åƒåœ¨è¶…å¤§å‹å›¾ä¹¦é¦†ä¸­å¿«é€Ÿæ‰¾ä¹¦ï¼Œéœ€è¦åˆç†åˆ©ç”¨ç´¢å¼•ï¼ˆç›®å½•ï¼‰ã€åˆ†åŒºï¼ˆåˆ†åŒºåŸŸå­˜æ”¾ï¼‰å’Œå„ç§æŠ€å·§æ¥é¿å…"å¤§æµ·æé’ˆ"ã€‚

**å¤§è¡¨æŸ¥è¯¢çš„å¸¸è§é—®é¢˜**ï¼š
- **ğŸŒ å…¨è¡¨æ‰«æ**ï¼šæ²¡æœ‰åˆé€‚ç´¢å¼•å¯¼è‡´æ‰«ææ•´ä¸ªè¡¨
- **ğŸ“Š ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸ**ï¼šä¼˜åŒ–å™¨åŸºäºé”™è¯¯ä¿¡æ¯é€‰æ‹©æ‰§è¡Œè®¡åˆ’
- **ğŸ”„ æ·±åº¦åˆ†é¡µ**ï¼šLIMITåç§»é‡å¾ˆå¤§æ—¶æ€§èƒ½æ€¥å‰§ä¸‹é™
- **ğŸ”— è·¨åˆ†åŒºæŸ¥è¯¢**ï¼šæŸ¥è¯¢æ¡ä»¶æ— æ³•åˆ©ç”¨åˆ†åŒºå‰ªæ
- **ğŸ’¾ å†…å­˜ä¸è¶³**ï¼šå¤§è¡¨æ•°æ®æ— æ³•å®Œå…¨è½½å…¥å†…å­˜

### 12.2 æŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯è¯¦è§£


**ç´¢å¼•ä¼˜åŒ–æŠ€æœ¯**ï¼š
```sql
-- âœ… åˆ©ç”¨è¦†ç›–ç´¢å¼•é¿å…å›è¡¨
-- æŸ¥è¯¢ï¼šSELECT customer_id, order_date, amount FROM orders WHERE status = 'paid'
CREATE INDEX idx_status_cover ON orders (status, customer_id, order_date, amount);

-- âœ… å‰ç¼€ç´¢å¼•ä¼˜åŒ–é•¿å­—ç¬¦ä¸²
-- å¯¹äºé•¿æ–‡æœ¬å­—æ®µï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•
ALTER TABLE products ADD INDEX idx_description_prefix (description(50));

-- âœ… å‡½æ•°ç´¢å¼•ä¼˜åŒ–è®¡ç®—åˆ—
-- MySQL 8.0 æ”¯æŒå‡½æ•°ç´¢å¼•
ALTER TABLE orders ADD INDEX idx_month_year ((YEAR(order_date) * 100 + MONTH(order_date)));

-- æŸ¥è¯¢æ—¶å¯ä»¥åˆ©ç”¨å‡½æ•°ç´¢å¼•
SELECT * FROM orders WHERE YEAR(order_date) * 100 + MONTH(order_date) = 202401;
```

**åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–**ï¼š
```sql
-- âŒ ä¼ ç»Ÿåˆ†é¡µï¼ˆæ·±åº¦åˆ†é¡µæ—¶å¾ˆæ…¢ï¼‰
SELECT * FROM orders ORDER BY order_date DESC LIMIT 100000, 20;

-- âœ… æ¸¸æ ‡åˆ†é¡µï¼ˆæ¨èï¼‰
-- ç¬¬ä¸€é¡µ
SELECT * FROM orders ORDER BY order_date DESC LIMIT 20;

-- åç»­é¡µï¼ˆä½¿ç”¨ä¸Šä¸€é¡µæœ€åä¸€æ¡è®°å½•çš„order_dateï¼‰
SELECT * FROM orders 
WHERE order_date < '2024-01-15 10:30:00'
ORDER BY order_date DESC 
LIMIT 20;

-- âœ… å»¶è¿Ÿå…³è”ä¼˜åŒ–
SELECT o.* FROM orders o
INNER JOIN (
    SELECT order_id FROM orders 
    ORDER BY order_date DESC 
    LIMIT 100000, 20
) temp ON o.order_id = temp.order_id;
```

**åˆ†åŒºæŸ¥è¯¢ä¼˜åŒ–**ï¼š
```sql
-- âœ… åˆ©ç”¨åˆ†åŒºå‰ªæ
-- æŸ¥è¯¢æŒ‡å®šæœˆä»½çš„æ•°æ®ï¼Œåªæ‰«æå¯¹åº”åˆ†åŒº
SELECT COUNT(*) FROM orders 
WHERE order_date >= '2024-01-01' 
  AND order_date < '2024-02-01';

-- âœ… åˆ†åŒºå¹¶è¡ŒæŸ¥è¯¢
-- å¯ä»¥å¹¶è¡ŒæŸ¥è¯¢å¤šä¸ªåˆ†åŒº
SELECT /*+ PARALLEL(4) */ 
    DATE_FORMAT(order_date, '%Y-%m') as month,
    COUNT(*) as order_count
FROM orders 
WHERE order_date >= '2024-01-01' 
  AND order_date < '2024-04-01'
GROUP BY DATE_FORMAT(order_date, '%Y-%m');
```

### 12.3 å¤æ‚æŸ¥è¯¢ä¼˜åŒ–å®ä¾‹


**å¤§è¡¨JOINä¼˜åŒ–**ï¼š
```sql
-- âŒ æœªä¼˜åŒ–çš„JOINæŸ¥è¯¢
SELECT o.order_id, c.customer_name, o.amount
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.order_date >= '2024-01-01';

-- âœ… ä¼˜åŒ–åçš„JOINæŸ¥è¯¢
-- 1. ç¡®ä¿JOINå­—æ®µéƒ½æœ‰ç´¢å¼•
ALTER TABLE orders ADD INDEX idx_customer_date (customer_id, order_date);
ALTER TABLE customers ADD INDEX idx_customer_id (customer_id);

-- 2. ä½¿ç”¨è¦†ç›–ç´¢å¼•
CREATE INDEX idx_customer_cover ON customers (customer_id, customer_name);

-- 3. ä¼˜åŒ–åçš„æŸ¥è¯¢
SELECT o.order_id, c.customer_name, o.amount
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.order_date >= '2024-01-01'
  AND o.customer_id IS NOT NULL;  -- é¿å…NULLå€¼å½±å“JOIN
```

**èšåˆæŸ¥è¯¢ä¼˜åŒ–**ï¼š
```sql
-- âŒ ä½æ•ˆçš„èšåˆæŸ¥è¯¢
SELECT 
    customer_id,
    COUNT(*) as order_count,
    SUM(amount) as total_amount
FROM orders 
WHERE order_date >= '2024-01-01'
GROUP BY customer_id;

-- âœ… ä¼˜åŒ–çš„èšåˆæŸ¥è¯¢
-- 1. åˆ›å»ºåˆé€‚çš„ç´¢å¼•
CREATE INDEX idx_date_customer ON orders (order_date, customer_id, amount);

-- 2. ä½¿ç”¨åˆ†åŒºè¡¨çš„å¹¶è¡Œèšåˆ
SELECT /*+ PARALLEL(4) */
    customer_id,
    COUNT(*) as order_count,
    SUM(amount) as total_amount
FROM orders 
WHERE order_date >= '2024-01-01'
  AND customer_id IS NOT NULL
GROUP BY customer_id
HAVING COUNT(*) >= 10;  -- è¿‡æ»¤å°å®¢æˆ·ï¼Œå‡å°‘ç»“æœé›†
```

### 12.4 æŸ¥è¯¢æ€§èƒ½ç›‘æ§ä¸è¯Šæ–­


**æ…¢æŸ¥è¯¢åˆ†æå·¥å…·**ï¼š
```sql
-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = ON;
SET GLOBAL long_query_time = 1;  -- è®°å½•è¶…è¿‡1ç§’çš„æŸ¥è¯¢
SET GLOBAL log_queries_not_using_indexes = ON;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢ç»Ÿè®¡
SELECT 
    schema_name,
    digest_text,
    count_star,
    avg_timer_wait/1000000000 AS avg_time_seconds,
    max_timer_wait/1000000000 AS max_time_seconds
FROM performance_schema.events_statements_summary_by_digest
WHERE schema_name IS NOT NULL
ORDER BY avg_timer_wait DESC
LIMIT 10;
```

**å®æ—¶æŸ¥è¯¢ç›‘æ§**ï¼š
```bash
#!/bin/bash
# å®æ—¶ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢

while true; do
    echo "=== $(date) ==="
    mysql -e "
    SELECT 
        id,
        user,
        host,
        db,
        command,
        time,
        state,
        LEFT(info, 100) as query_preview
    FROM information_schema.processlist 
    WHERE time > 30 
      AND command != 'Sleep'
      AND info NOT LIKE '%processlist%'
    ORDER BY time DESC;
    "
    echo ""
    sleep 10
done
```

**æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’åˆ†æ**ï¼š
```sql
-- ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢
EXPLAIN FORMAT=JSON 
SELECT * FROM orders 
WHERE customer_id = 12345 
  AND order_date >= '2024-01-01'
ORDER BY order_date DESC 
LIMIT 10;

-- ä½¿ç”¨EXPLAIN ANALYZEï¼ˆMySQL 8.0.18+ï¼‰
EXPLAIN ANALYZE 
SELECT * FROM orders 
WHERE customer_id = 12345 
  AND order_date >= '2024-01-01'
ORDER BY order_date DESC 
LIMIT 10;
```

---

## 13. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 13.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å¤§è¡¨å®šä¹‰æ ‡å‡†**ï¼šæ ¹æ®æ•°æ®é‡ã€å­˜å‚¨å¤§å°ã€æ“ä½œè€—æ—¶æ¥å®šä¹‰å¤§è¡¨çº§åˆ«
**ğŸ”¸ ç»´æŠ¤çª—å£è§„åˆ’**ï¼šåˆç†å®‰æ’ç»´æŠ¤æ—¶é—´ï¼Œç¡®ä¿è¶³å¤Ÿçš„æ“ä½œå’Œå›æ»šæ—¶é—´
**ğŸ”¸ åœ¨çº¿DDLç­–ç•¥**ï¼šæŒæ¡MySQLåŸç”Ÿå’Œç¬¬ä¸‰æ–¹å·¥å…·çš„åœ¨çº¿å˜æ›´æ–¹æ³•
**ğŸ”¸ å¤‡ä»½æ¢å¤æ–¹æ¡ˆ**ï¼šåˆ†å±‚å¤‡ä»½ç­–ç•¥ï¼Œç‰©ç†å¤‡ä»½ä¼˜äºé€»è¾‘å¤‡ä»½
**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯**ï¼šç´¢å¼•è®¾è®¡ã€æŸ¥è¯¢ä¼˜åŒ–ã€åˆ†åŒºç­–ç•¥çš„ç»¼åˆè¿ç”¨

### 13.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¤§è¡¨è¿ç»´çš„æ ¸å¿ƒæ€æƒ³**
```
åˆ†è€Œæ²»ä¹‹ï¼šé€šè¿‡åˆ†åŒºã€åˆ†è¡¨å°†å¤§è¡¨å˜æˆå¯ç®¡ç†çš„å°è¡¨
é¢„é˜²ä¸ºä¸»ï¼šé€šè¿‡ç›‘æ§é¢„è­¦ï¼Œåœ¨é—®é¢˜å‘ç”Ÿå‰å°±å¼€å§‹å¤„ç†
è‡ªåŠ¨åŒ–ä¼˜å…ˆï¼šé€šè¿‡è„šæœ¬å’Œå·¥å…·å‡å°‘äººå·¥æ“ä½œï¼Œé™ä½å‡ºé”™é£é™©
ä¸šåŠ¡ä¼˜å…ˆï¼šæ‰€æœ‰è¿ç»´æ“ä½œéƒ½è¦è€ƒè™‘å¯¹ä¸šåŠ¡çš„å½±å“
```

**ğŸ”¹ å¤§è¡¨ä¼˜åŒ–çš„å¹³è¡¡è‰ºæœ¯**
```
æ€§èƒ½ vs å¤æ‚åº¦ï¼šä¼˜åŒ–ä¼šå¢åŠ ç³»ç»Ÿå¤æ‚åº¦
ç©ºé—´ vs æ—¶é—´ï¼šç´¢å¼•å ç”¨ç©ºé—´ä½†æå‡æŸ¥è¯¢é€Ÿåº¦
ä¸€è‡´æ€§ vs å¯ç”¨æ€§ï¼šæŸäº›ä¼˜åŒ–å¯èƒ½å½±å“æ•°æ®ä¸€è‡´æ€§
æˆæœ¬ vs æ”¶ç›Šï¼šä¼˜åŒ–æŠ•å…¥ä¸æ€§èƒ½æå‡çš„å¹³è¡¡
```

**ğŸ”¹ åˆ†åŒºç­–ç•¥çš„é€‰æ‹©åŸåˆ™**
```
æ—¶é—´åºåˆ—æ•°æ® â†’ RANGEåˆ†åŒº
å‡åŒ€åˆ†å¸ƒæ•°æ® â†’ HASHåˆ†åŒº
æ˜ç¡®åˆ†ç±»æ•°æ® â†’ LISTåˆ†åŒº
æ— æ˜æ˜¾ç‰¹å¾ â†’ ä¸å»ºè®®åˆ†åŒº
```

### 13.3 å®é™…åº”ç”¨æŒ‡å¯¼


**è¿ç»´æµç¨‹æ ‡å‡†åŒ–**ï¼š
```
æ—¥å¸¸ç›‘æ§ï¼š
âœ… æ¯æ—¥æ£€æŸ¥å¤§è¡¨å¤§å°å¢é•¿
âœ… ç›‘æ§æ…¢æŸ¥è¯¢å’Œé”ç­‰å¾…
âœ… æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ

å‘¨æœŸç»´æŠ¤ï¼š
âœ… æ¯å‘¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
âœ… æ¯æœˆåˆ†æç´¢å¼•å¥åº·çŠ¶æ€
âœ… æ¯å­£åº¦è¯„ä¼°åˆ†åŒºç­–ç•¥

åº”æ€¥å“åº”ï¼š
âœ… åˆ¶å®šå¤§è¡¨æ•…éšœåº”æ€¥é¢„æ¡ˆ
âœ… å‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ
âœ… å»ºç«‹å‡çº§é€šçŸ¥æœºåˆ¶
```

**æŠ€æœ¯é€‰å‹å»ºè®®**ï¼š
```
å°äº100GBï¼š
- ä½¿ç”¨MySQLåŸç”ŸåŠŸèƒ½
- å®šæœŸç»´æŠ¤å³å¯

100GB-1TBï¼š
- å¿…é¡»ä½¿ç”¨åˆ†åŒº
- è€ƒè™‘è¯»å†™åˆ†ç¦»
- ä½¿ç”¨ä¸“ä¸šç›‘æ§å·¥å…·

å¤§äº1TBï¼š
- å¿…é¡»åˆ†åº“åˆ†è¡¨
- ä½¿ç”¨ä¸­é—´ä»¶
- ä¸“ä¸šDBAå›¢é˜Ÿç»´æŠ¤
```

### 13.4 å¸¸è§è¯¯åŒºé¿å…


**âŒ é”™è¯¯åšæ³•**ï¼š
- ç­‰åˆ°è¡¨å·²ç»å¾ˆå¤§æ‰å¼€å§‹ä¼˜åŒ–
- ç›²ç›®æ·»åŠ ç´¢å¼•è€Œä¸è€ƒè™‘ç»´æŠ¤æˆæœ¬
- åœ¨ä¸šåŠ¡é«˜å³°æœŸè¿›è¡Œå¤§è¡¨ç»´æŠ¤
- ä¸å¤‡ä»½å°±ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒæ“ä½œ
- å¿½è§†ç›‘æ§ï¼Œç­‰å‡ºé—®é¢˜æ‰å‘ç°

**âœ… æ­£ç¡®åšæ³•**ï¼š
- æå‰è§„åˆ’ï¼Œé¢„é˜²æ€§ä¼˜åŒ–
- åŸºäºæŸ¥è¯¢æ¨¡å¼è®¾è®¡ç´¢å¼•
- åœ¨ç»´æŠ¤çª—å£æœŸè¿›è¡Œé‡å‹æ“ä½œ
- å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œå†ä¸Šç”Ÿäº§
- å»ºç«‹å®Œå–„çš„ç›‘æ§å‘Šè­¦ä½“ç³»

### 13.5 å‘å±•è¶‹åŠ¿ä¸å±•æœ›


**æŠ€æœ¯å‘å±•æ–¹å‘**ï¼š
- **äº‘åŸç”Ÿæ•°æ®åº“**ï¼šè‡ªåŠ¨åˆ†åŒºã€å¼¹æ€§æ‰©ç¼©å®¹
- **AIè¾…åŠ©ä¼˜åŒ–**ï¼šæ™ºèƒ½ç´¢å¼•æ¨èã€è‡ªåŠ¨å‚æ•°è°ƒä¼˜
- **åˆ†å¸ƒå¼æ¶æ„**ï¼šå¤©ç„¶æ”¯æŒå¤§è¡¨çš„åˆ†å¸ƒå¼æ•°æ®åº“
- **å®æ—¶åˆ†æ**ï¼šHTAPæ¶æ„æ”¯æŒå¤§è¡¨çš„å®æ—¶åˆ†æ

**è¿ç»´è‡ªåŠ¨åŒ–è¶‹åŠ¿**ï¼š
- **æ™ºèƒ½ç›‘æ§**ï¼šåŸºäºæœºå™¨å­¦ä¹ çš„å¼‚å¸¸æ£€æµ‹
- **è‡ªæ„ˆç³»ç»Ÿ**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä¿®å¤å¸¸è§é—®é¢˜
- **å®¹é‡é¢„æµ‹**ï¼šåŸºäºä¸šåŠ¡æ¨¡å¼çš„ç²¾å‡†å®¹é‡è§„åˆ’
- **é›¶åœæœºç»´æŠ¤**ï¼šå®Œå…¨åœ¨çº¿çš„è¡¨ç»“æ„å˜æ›´

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¤§è¡¨è¿ç»´éœ€è¦ä½“ç³»åŒ–æ€è€ƒï¼Œä¸èƒ½å¤´ç—›åŒ»å¤´
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œç›‘æ§é¢„è­¦æ˜¯å…³é”®
- åˆ†åŒºåˆ†è¡¨æ˜¯å¤§è¡¨ç®¡ç†çš„æ ¸å¿ƒæŠ€æœ¯
- è‡ªåŠ¨åŒ–è¿ç»´æ˜¯å¤§è¡¨ç®¡ç†çš„å‘å±•æ–¹å‘
- ä¸šåŠ¡è¿ç»­æ€§æ°¸è¿œæ˜¯ç¬¬ä¸€ä¼˜å…ˆçº§