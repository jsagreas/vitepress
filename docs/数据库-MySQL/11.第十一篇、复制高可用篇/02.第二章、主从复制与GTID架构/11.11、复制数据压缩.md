---
title: 11ã€å¤åˆ¶æ•°æ®å‹ç¼©
---
## ğŸ“š ç›®å½•

1. [å¤åˆ¶æ•°æ®å‹ç¼©æ¦‚è¿°](#1-å¤åˆ¶æ•°æ®å‹ç¼©æ¦‚è¿°)
2. [Binlogå‹ç¼©ç®—æ³•è¯¦è§£](#2-Binlogå‹ç¼©ç®—æ³•è¯¦è§£)
3. [ä¼ è¾“æ•°æ®å‹ç¼©æœºåˆ¶](#3-ä¼ è¾“æ•°æ®å‹ç¼©æœºåˆ¶)
4. [å‹ç¼©ç‡ä¸æ€§èƒ½æƒè¡¡](#4-å‹ç¼©ç‡ä¸æ€§èƒ½æƒè¡¡)
5. [å‹ç¼©å‚æ•°é…ç½®å®æˆ˜](#5-å‹ç¼©å‚æ•°é…ç½®å®æˆ˜)
6. [è§£å‹ç¼©æ€§èƒ½å½±å“åˆ†æ](#6-è§£å‹ç¼©æ€§èƒ½å½±å“åˆ†æ)
7. [ç½‘ç»œå¸¦å®½èŠ‚çœæ•ˆæœ](#7-ç½‘ç»œå¸¦å®½èŠ‚çœæ•ˆæœ)
8. [å‹ç¼©æ•…éšœå¤„ç†æŒ‡å—](#8-å‹ç¼©æ•…éšœå¤„ç†æŒ‡å—)
9. [å‹ç¼©ç›‘æ§æŒ‡æ ‡è¯¦è§£](#9-å‹ç¼©ç›‘æ§æŒ‡æ ‡è¯¦è§£)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—œï¸ å¤åˆ¶æ•°æ®å‹ç¼©æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯MySQLå¤åˆ¶æ•°æ®å‹ç¼©


**ç®€å•ç†è§£**ï¼šå°±åƒæŠŠæ–‡ä»¶æ‰“åŒ…æˆZIPä¸€æ ·ï¼ŒMySQLå¯ä»¥æŠŠä¸»ä»å¤åˆ¶æ—¶ä¼ è¾“çš„æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œè®©ç½‘ç»œä¼ è¾“æ›´å¿«ã€å ç”¨å¸¦å®½æ›´å°‘ã€‚

```
ä¼ ç»Ÿå¤åˆ¶è¿‡ç¨‹ï¼š
ä¸»åº“ â”€â”€[åŸå§‹æ•°æ®]â”€â”€> ä»åº“
     å¤§æ–‡ä»¶ä¼ è¾“æ…¢

å‹ç¼©å¤åˆ¶è¿‡ç¨‹ï¼š
ä¸»åº“ â”€â”€[å‹ç¼©æ•°æ®]â”€â”€> ä»åº“
     å°æ–‡ä»¶ä¼ è¾“å¿«
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **å‡å°‘ç½‘ç»œæµé‡**ï¼šå‹ç¼©åæ•°æ®å˜å°ï¼Œä¼ è¾“æ›´å¿«
- **èŠ‚çœå¸¦å®½æˆæœ¬**ï¼šç‰¹åˆ«æ˜¯è·¨åœ°åŸŸå¤åˆ¶æ—¶å¾ˆé‡è¦
- **æé«˜å¤åˆ¶æ•ˆç‡**ï¼šåœ¨ç½‘ç»œæ¡ä»¶å·®çš„ç¯å¢ƒä¸‹æ•ˆæœæ˜æ˜¾
- **é™ä½ç½‘ç»œå»¶è¿Ÿ**ï¼šæ•°æ®åŒ…å˜å°ï¼Œä¼ è¾“æ—¶é—´ç¼©çŸ­

### 1.2 å‹ç¼©å¤åˆ¶çš„åº”ç”¨åœºæ™¯


**æœ€é€‚åˆçš„åœºæ™¯**ï¼š
```
ğŸŒ è·¨åœ°åŸŸå¤åˆ¶ï¼š
- ä¸åŒåŸå¸‚çš„æ•°æ®ä¸­å¿ƒä¹‹é—´
- æµ·å¤–åˆ†æ”¯æœºæ„åŒæ­¥
- äº‘æœåŠ¡å•†ä¸åŒåŒºåŸŸ

ğŸ“¶ ç½‘ç»œå¸¦å®½å—é™ï¼š
- ä¸“çº¿å¸¦å®½æˆæœ¬é«˜
- å…¬ç½‘å¸¦å®½æœ‰é™åˆ¶
- ç§»åŠ¨ç½‘ç»œç¯å¢ƒ

ğŸ“Š æ•°æ®é‡å¤§çš„ä¸šåŠ¡ï¼š
- æ—¥å¿—ç³»ç»Ÿå¤åˆ¶
- å¤§æ–‡æœ¬å­—æ®µè¾ƒå¤š
- é¢‘ç¹çš„æ•°æ®æ›´æ–°
```

**ä¸å¤ªé€‚åˆçš„åœºæ™¯**ï¼š
- å±€åŸŸç½‘å†…å¤åˆ¶ï¼ˆç½‘ç»œé€Ÿåº¦å·²ç»å¾ˆå¿«ï¼‰
- CPUèµ„æºç´§å¼ çš„æœåŠ¡å™¨
- æ•°æ®æœ¬èº«å·²ç»æ˜¯å‹ç¼©æ ¼å¼ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ï¼‰

---

## 2. ğŸ”§ Binlogå‹ç¼©ç®—æ³•è¯¦è§£


### 2.1 MySQLæ”¯æŒçš„å‹ç¼©ç®—æ³•


**zlibç®—æ³•ï¼ˆé»˜è®¤ï¼‰**ï¼š
```
ç‰¹ç‚¹ï¼š
âœ… å‹ç¼©ç‡é€‚ä¸­ï¼ˆé€šå¸¸30-70%ï¼‰
âœ… CPUæ¶ˆè€—è¾ƒä½
âœ… å…¼å®¹æ€§æœ€å¥½
âœ… ç¨³å®šæ€§é«˜

é€‚ç”¨åœºæ™¯ï¼šå¤§å¤šæ•°ç”Ÿäº§ç¯å¢ƒçš„é¦–é€‰
```

**lz4ç®—æ³•ï¼ˆMySQL 8.0.20+ï¼‰**ï¼š
```
ç‰¹ç‚¹ï¼š
âœ… å‹ç¼©é€Ÿåº¦æå¿«
âœ… CPUæ¶ˆè€—æœ€ä½
âŒ å‹ç¼©ç‡ç›¸å¯¹è¾ƒä½
âœ… è§£å‹é€Ÿåº¦å¿«

é€‚ç”¨åœºæ™¯ï¼šå¯¹å®æ—¶æ€§è¦æ±‚æé«˜çš„ç¯å¢ƒ
```

**zstdç®—æ³•ï¼ˆMySQL 8.0.20+ï¼‰**ï¼š
```
ç‰¹ç‚¹ï¼š
âœ… å‹ç¼©ç‡æœ€é«˜ï¼ˆå¯è¾¾80%ä»¥ä¸Šï¼‰
âœ… å¯è°ƒèŠ‚å‹ç¼©çº§åˆ«
âŒ CPUæ¶ˆè€—ç›¸å¯¹è¾ƒé«˜
âœ… æ–°ä¸€ä»£å‹ç¼©æ ‡å‡†

é€‚ç”¨åœºæ™¯ï¼šç½‘ç»œå¸¦å®½æå…¶å®è´µçš„ç¯å¢ƒ
```

### 2.2 å‹ç¼©ç®—æ³•å¯¹æ¯”


| ç®—æ³• | **å‹ç¼©ç‡** | **å‹ç¼©é€Ÿåº¦** | **CPUæ¶ˆè€—** | **å…¼å®¹æ€§** | **æ¨èåœºæ™¯** |
|------|-----------|-------------|------------|-----------|-------------|
| **zlib** | `ä¸­ç­‰(50-70%)` | `ä¸­ç­‰` | `ä¸­ç­‰` | `æœ€å¥½` | `é€šç”¨åœºæ™¯` |
| **lz4** | `è¾ƒä½(30-50%)` | `æœ€å¿«` | `æœ€ä½` | `è¾ƒå¥½` | `å®æ—¶å¤åˆ¶` |
| **zstd** | `æœ€é«˜(60-80%)` | `è¾ƒæ…¢` | `è¾ƒé«˜` | `è¾ƒæ–°` | `å¸¦å®½å—é™` |

### 2.3 ç®—æ³•é€‰æ‹©æŒ‡å¯¼


```
ğŸ¯ é€‰æ‹©ç­–ç•¥ï¼š

ç½‘ç»œå¸¦å®½å……è¶³ï¼Œè¿½æ±‚æ€§èƒ½ï¼š
â†’ é€‰æ‹© lz4 ç®—æ³•

ç½‘ç»œå¸¦å®½å—é™ï¼Œè¦èŠ‚çœæˆæœ¬ï¼š
â†’ é€‰æ‹© zstd ç®—æ³•

å¹³è¡¡æ€§èƒ½å’Œå¸¦å®½ï¼Œè¦ç¨³å®šï¼š
â†’ é€‰æ‹© zlib ç®—æ³•ï¼ˆæ¨èï¼‰
```

---

## 3. ğŸ“¡ ä¼ è¾“æ•°æ®å‹ç¼©æœºåˆ¶


### 3.1 å‹ç¼©ä¼ è¾“çš„å·¥ä½œæµç¨‹


```
å®Œæ•´å‹ç¼©å¤åˆ¶æµç¨‹ï¼š

ä¸»åº“ç«¯ï¼š
1. ç”ŸæˆBinlogäº‹ä»¶
2. åº”ç”¨å‹ç¼©ç®—æ³•
3. å‘é€å‹ç¼©æ•°æ®

ç½‘ç»œä¼ è¾“ï¼š
4. ä¼ è¾“å‹ç¼©åçš„æ•°æ®åŒ…

ä»åº“ç«¯ï¼š
5. æ¥æ”¶å‹ç¼©æ•°æ®
6. è§£å‹ç¼©æ•°æ®
7. åº”ç”¨åˆ°ä»åº“
```

**è¯¦ç»†è¿‡ç¨‹å›¾ç¤º**ï¼š
```
ä¸»åº“                     ç½‘ç»œ                    ä»åº“
 â”‚                        â”‚                      â”‚
 â”‚[1]å†™å…¥Binlog            â”‚                      â”‚
 â”‚[2]è¯»å–Binlogäº‹ä»¶        â”‚                      â”‚
 â”‚[3]å‹ç¼©æ•°æ®              â”‚                      â”‚
 â”‚[4]å‘é€å‹ç¼©åŒ…----------->â”‚                      â”‚
 â”‚                        â”‚[5]ä¼ è¾“å‹ç¼©æ•°æ®------->â”‚
 â”‚                        â”‚                      â”‚[6]æ¥æ”¶æ•°æ®
 â”‚                        â”‚                      â”‚[7]è§£å‹ç¼©
 â”‚                        â”‚                      â”‚[8]åº”ç”¨äº‹ä»¶
```

### 3.2 å‹ç¼©çš„æ•°æ®ç±»å‹


**ä¼šè¢«å‹ç¼©çš„æ•°æ®**ï¼š
- Binlogäº‹ä»¶å†…å®¹
- SQLè¯­å¥æ–‡æœ¬
- æ•°æ®è¡Œå†…å®¹
- è¡¨ç»“æ„å˜æ›´ä¿¡æ¯

**ä¸ä¼šè¢«å‹ç¼©çš„æ•°æ®**ï¼š
- äº‹ä»¶å¤´ä¿¡æ¯
- æ ¡éªŒå’Œæ•°æ®
- åè®®æ§åˆ¶ä¿¡æ¯
- å¿ƒè·³åŒ…æ•°æ®

### 3.3 å‹ç¼©çº§åˆ«è®¾ç½®


```sql
-- è®¾ç½®å‹ç¼©çº§åˆ«ï¼ˆä»¥zstdä¸ºä¾‹ï¼‰
-- çº§åˆ«èŒƒå›´ï¼š1-22ï¼Œæ•°å­—è¶Šå¤§å‹ç¼©ç‡è¶Šé«˜ä½†é€Ÿåº¦è¶Šæ…¢

-- ä½å‹ç¼©çº§åˆ«ï¼ˆå¿«é€Ÿï¼‰
SET GLOBAL binlog_transaction_compression_level_zstd = 3;

-- ä¸­ç­‰å‹ç¼©çº§åˆ«ï¼ˆå¹³è¡¡ï¼‰
SET GLOBAL binlog_transaction_compression_level_zstd = 6;

-- é«˜å‹ç¼©çº§åˆ«ï¼ˆæœ€ä¼˜å‹ç¼©ï¼‰
SET GLOBAL binlog_transaction_compression_level_zstd = 10;
```

---

## 4. âš–ï¸ å‹ç¼©ç‡ä¸æ€§èƒ½æƒè¡¡


### 4.1 å‹ç¼©ç‡å½±å“å› ç´ 


**æ•°æ®ç‰¹å¾å½±å“**ï¼š
```
é«˜å‹ç¼©ç‡çš„æ•°æ®ç±»å‹ï¼š
ğŸ“ æ–‡æœ¬æ•°æ®ï¼šJSONã€XMLã€æ—¥å¿—
ğŸ“Š é‡å¤æ•°æ®ï¼šæ‰¹é‡æ’å…¥çš„ç›¸ä¼¼è®°å½•
ğŸ”¤ å­—ç¬¦ä¸²å­—æ®µï¼šç”¨æˆ·è¯„è®ºã€æè¿°ä¿¡æ¯

ä½å‹ç¼©ç‡çš„æ•°æ®ç±»å‹ï¼š
ğŸ–¼ï¸ äºŒè¿›åˆ¶æ•°æ®ï¼šå›¾ç‰‡ã€è§†é¢‘ã€æ–‡ä»¶
ğŸ”¢ éšæœºæ•°æ®ï¼šUUIDã€åŠ å¯†æ•°æ®
ğŸ—œï¸ å·²å‹ç¼©æ•°æ®ï¼šZIPæ–‡ä»¶ã€å‹ç¼©å›¾ç‰‡
```

**å®é™…å‹ç¼©æ•ˆæœç¤ºä¾‹**ï¼š
```
æ•°æ®ç±»å‹ç¤ºä¾‹ï¼š

è®¢å•è¡¨ï¼ˆåŒ…å«å¤§é‡æ–‡æœ¬ï¼‰ï¼š
åŸå§‹å¤§å°ï¼š100MB
å‹ç¼©åï¼š35MB
å‹ç¼©ç‡ï¼š65%

ç”¨æˆ·å¤´åƒè¡¨ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼š
åŸå§‹å¤§å°ï¼š100MB  
å‹ç¼©åï¼š95MB
å‹ç¼©ç‡ï¼š5%

æ—¥å¿—è¡¨ï¼ˆé‡å¤æ€§é«˜ï¼‰ï¼š
åŸå§‹å¤§å°ï¼š100MB
å‹ç¼©åï¼š15MB
å‹ç¼©ç‡ï¼š85%
```

### 4.2 æ€§èƒ½å½±å“åˆ†æ


**CPUä½¿ç”¨å½±å“**ï¼š
```
ğŸ“ˆ å‹ç¼©å¯¹CPUçš„å½±å“ï¼š

ä¸»åº“CPUå¢åŠ ï¼š
- å‹ç¼©è®¡ç®—ï¼šå¢åŠ 5-15%
- å†…å­˜ä½¿ç”¨ï¼šå¢åŠ 10-30MB
- IOå‡å°‘ï¼šç½‘ç»œIOé™ä½30-70%

ä»åº“CPUå¢åŠ ï¼š
- è§£å‹è®¡ç®—ï¼šå¢åŠ 3-10%
- åº”ç”¨å»¶è¿Ÿï¼šåŸºæœ¬æ— å½±å“
- å†…å­˜ä½¿ç”¨ï¼šå¢åŠ 10-20MB
```

**ç½‘ç»œæ€§èƒ½å½±å“**ï¼š
```
ğŸŒ ç½‘ç»œä¼ è¾“æ”¹å–„ï¼š

ä¼ è¾“æ—¶é—´å‡å°‘ï¼š
- æœ¬åœ°ç½‘ç»œï¼šæå‡10-30%
- è·¨åŸç½‘ç»œï¼šæå‡50-80%
- å›½é™…ç½‘ç»œï¼šæå‡70-90%

å¸¦å®½èŠ‚çœï¼š
- å¹³å‡èŠ‚çœï¼š50-70%
- æœ€å¤§èŠ‚çœï¼šå¯è¾¾90%
- æˆæœ¬é™ä½ï¼šæ˜¾è‘—ï¼ˆè·¨åŒºåŸŸå¤åˆ¶ï¼‰
```

### 4.3 æ€§èƒ½æƒè¡¡ç­–ç•¥


```
ğŸ¯ æƒè¡¡å†³ç­–çŸ©é˜µï¼š

CPUèµ„æºå……è¶³ + ç½‘ç»œå¸¦å®½å—é™ï¼š
â†’ å¯ç”¨é«˜å‹ç¼©çº§åˆ«
â†’ é€‰æ‹©zstdç®—æ³•
â†’ é‡ç‚¹å…³æ³¨ç½‘ç»œæ€§èƒ½

CPUèµ„æºç´§å¼  + ç½‘ç»œå¸¦å®½å……è¶³ï¼š
â†’ ä¸å¯ç”¨å‹ç¼©
â†’ æˆ–é€‰æ‹©lz4ä½CPUç®—æ³•
â†’ é‡ç‚¹å…³æ³¨CPUä½¿ç”¨ç‡

CPUå’Œç½‘ç»œéƒ½ä¸€èˆ¬ï¼š
â†’ å¯ç”¨ä¸­ç­‰å‹ç¼©çº§åˆ«
â†’ é€‰æ‹©zlibç®—æ³•
â†’ å¹³è¡¡å„é¡¹æŒ‡æ ‡
```

---

## 5. âš™ï¸ å‹ç¼©å‚æ•°é…ç½®å®æˆ˜


### 5.1 åŸºç¡€é…ç½®å‚æ•°


**å¯ç”¨Binlogå‹ç¼©**ï¼š
```sql
-- ä¸»åº“é…ç½®ï¼šå¯ç”¨binlogäº‹åŠ¡å‹ç¼©
SET GLOBAL binlog_transaction_compression = ON;

-- è®¾ç½®å‹ç¼©ç®—æ³•
SET GLOBAL binlog_transaction_compression_algorithm = 'zlib';

-- è®¾ç½®å‹ç¼©é˜ˆå€¼ï¼ˆå°äºè¯¥å€¼ä¸å‹ç¼©ï¼‰
SET GLOBAL binlog_transaction_compression_threshold = 256;
```

**ä»åº“é…ç½®**ï¼š
```sql
-- ä»åº“ä¼šè‡ªåŠ¨è¯†åˆ«å‹ç¼©æ•°æ®å¹¶è§£å‹
-- æ— éœ€ç‰¹æ®Šé…ç½®ï¼Œä½†å¯ä»¥ç›‘æ§è§£å‹æ€§èƒ½

-- æŸ¥çœ‹è§£å‹ç»Ÿè®¡
SHOW SLAVE STATUS\G
-- æŸ¥çœ‹ç›¸å…³çŠ¶æ€å˜é‡
SHOW STATUS LIKE 'Binlog%compression%';
```

### 5.2 é…ç½®æ–‡ä»¶è®¾ç½®


**my.cnfé…ç½®ç¤ºä¾‹**ï¼š
```ini
[mysqld]
# å¯ç”¨binlogå‹ç¼©
binlog_transaction_compression = ON

# è®¾ç½®å‹ç¼©ç®—æ³•ï¼ˆzlib/lz4/zstdï¼‰
binlog_transaction_compression_algorithm = zlib

# å‹ç¼©é˜ˆå€¼ï¼ˆå­—èŠ‚ï¼‰
binlog_transaction_compression_threshold = 256

# zlibå‹ç¼©çº§åˆ«ï¼ˆ1-9ï¼‰
binlog_transaction_compression_level_zlib = 6

# å¦‚æœä½¿ç”¨zstdï¼ˆMySQL 8.0.20+ï¼‰
# binlog_transaction_compression_algorithm = zstd
# binlog_transaction_compression_level_zstd = 6
```

### 5.3 åŠ¨æ€è°ƒæ•´é…ç½®


```sql
-- æŸ¥çœ‹å½“å‰å‹ç¼©é…ç½®
SELECT 
    $$binlog_transaction_compression as 'å‹ç¼©å¼€å…³',
    $$binlog_transaction_compression_algorithm as 'å‹ç¼©ç®—æ³•',
    $$binlog_transaction_compression_threshold as 'å‹ç¼©é˜ˆå€¼',
    $$binlog_transaction_compression_level_zlib as 'å‹ç¼©çº§åˆ«';

-- åŠ¨æ€è°ƒæ•´å‹ç¼©çº§åˆ«
SET GLOBAL binlog_transaction_compression_level_zlib = 9;

-- åˆ‡æ¢å‹ç¼©ç®—æ³•ï¼ˆéœ€è¦MySQL 8.0.20+ï¼‰
SET GLOBAL binlog_transaction_compression_algorithm = 'zstd';
SET GLOBAL binlog_transaction_compression_level_zstd = 6;

-- ä¸´æ—¶å…³é—­å‹ç¼©ï¼ˆæµ‹è¯•ç”¨ï¼‰
SET GLOBAL binlog_transaction_compression = OFF;
```

### 5.4 å‹ç¼©é˜ˆå€¼ä¼˜åŒ–


```sql
-- å‹ç¼©é˜ˆå€¼çš„é€‰æ‹©åŸåˆ™ï¼š

-- è¿‡å°çš„é˜ˆå€¼ï¼ˆå¦‚64å­—èŠ‚ï¼‰ï¼š
-- ä¼˜ç‚¹ï¼šå‹ç¼©æ›´å¤šæ•°æ®
-- ç¼ºç‚¹ï¼šå°äº‹åŠ¡å‹ç¼©æ— æ„ä¹‰ï¼Œæµªè´¹CPU

-- è¿‡å¤§çš„é˜ˆå€¼ï¼ˆå¦‚4KBï¼‰ï¼š
-- ä¼˜ç‚¹ï¼šé¿å…æ— æ•ˆå‹ç¼©
-- ç¼ºç‚¹ï¼šé”™è¿‡ä¸­ç­‰å¤§å°äº‹åŠ¡çš„å‹ç¼©æœºä¼š

-- æ¨èé˜ˆå€¼è®¾ç½®ï¼š
SET GLOBAL binlog_transaction_compression_threshold = 256;
-- å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œ256å­—èŠ‚æ˜¯æ¯”è¾ƒå¥½çš„å¹³è¡¡ç‚¹
```

---

## 6. ğŸ“Š è§£å‹ç¼©æ€§èƒ½å½±å“åˆ†æ


### 6.1 è§£å‹ç¼©CPUå¼€é”€


**ä»åº“è§£å‹æ€§èƒ½ç‰¹ç‚¹**ï¼š
```
è§£å‹ç¼©çš„ä¼˜åŠ¿ï¼š
âœ… è§£å‹æ¯”å‹ç¼©å¿«3-5å€
âœ… å†…å­˜ä½¿ç”¨é‡è¾ƒå°
âœ… å¯ä»¥æµå¼è§£å‹
âœ… å¯¹å¤åˆ¶å»¶è¿Ÿå½±å“å¾ˆå°

è§£å‹ç¼©çš„æ¶ˆè€—ï¼š
ğŸ“Š CPUä½¿ç”¨ï¼šå¢åŠ 3-10%
ğŸ’¾ å†…å­˜ä½¿ç”¨ï¼šå¢åŠ 10-20MB
â±ï¸ å»¶è¿Ÿå¢åŠ ï¼šé€šå¸¸<1ms
```

**ä¸åŒç®—æ³•è§£å‹æ€§èƒ½**ï¼š
```
lz4è§£å‹ï¼š
- é€Ÿåº¦ï¼šæœ€å¿«ï¼ˆ500MB/s+ï¼‰
- CPUï¼šæœ€ä½
- å†…å­˜ï¼šæœ€å°‘

zlibè§£å‹ï¼š
- é€Ÿåº¦ï¼šä¸­ç­‰ï¼ˆ200-300MB/sï¼‰
- CPUï¼šä¸­ç­‰
- å†…å­˜ï¼šä¸­ç­‰

zstdè§£å‹ï¼š
- é€Ÿåº¦ï¼šè¾ƒå¿«ï¼ˆ300-400MB/sï¼‰
- CPUï¼šç¨é«˜
- å†…å­˜ï¼šç¨å¤š
```

### 6.2 è§£å‹ç¼©å†…å­˜ç®¡ç†


**å†…å­˜ä½¿ç”¨æ¨¡å¼**ï¼š
```sql
-- æŸ¥çœ‹è§£å‹ç›¸å…³çš„å†…å­˜ä½¿ç”¨
SHOW STATUS LIKE 'Com_binlog%';
SHOW STATUS LIKE 'Binlog%bytes%';

-- ç›‘æ§è§£å‹ç¼“å†²åŒºä½¿ç”¨
SHOW VARIABLES LIKE '%buffer%';
```

**å†…å­˜ä¼˜åŒ–å»ºè®®**ï¼š
```
ğŸ”§ å†…å­˜ä¼˜åŒ–ç­–ç•¥ï¼š

é€‚å½“å¢åŠ è§£å‹ç¼“å†²åŒºï¼š
read_buffer_size = 2M
binlog_cache_size = 1M

ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µï¼š
å®šæœŸæ£€æŸ¥è§£å‹è¿‡ç¨‹çš„å†…å­˜å³°å€¼
é¿å…å†…å­˜ä¸è¶³å¯¼è‡´çš„æ€§èƒ½é—®é¢˜

åˆç†è®¾ç½®å‹ç¼©çº§åˆ«ï¼š
è¿‡é«˜çš„å‹ç¼©çº§åˆ«ä¼šå¢åŠ è§£å‹å†…å­˜éœ€æ±‚
```

### 6.3 è§£å‹å¼‚å¸¸å¤„ç†


**å¸¸è§è§£å‹é—®é¢˜**ï¼š
```
ğŸš¨ è§£å‹å¤±è´¥åœºæ™¯ï¼š

å‹ç¼©æ•°æ®æŸåï¼š
é”™è¯¯ï¼šBinlog decompression failed
å¤„ç†ï¼šæ£€æŸ¥ç½‘ç»œä¼ è¾“è´¨é‡

ç®—æ³•ä¸åŒ¹é…ï¼š
é”™è¯¯ï¼šUnknown compression algorithm
å¤„ç†ï¼šç¡®ä¿ä¸»ä»ç‰ˆæœ¬å…¼å®¹

å†…å­˜ä¸è¶³ï¼š
é”™è¯¯ï¼šOut of memory during decompression
å¤„ç†ï¼šå¢åŠ ä»åº“å†…å­˜æˆ–é™ä½å‹ç¼©çº§åˆ«
```

**è§£å‹ç›‘æ§SQL**ï¼š
```sql
-- æŸ¥çœ‹è§£å‹ç»Ÿè®¡ä¿¡æ¯
SELECT 
    COUNT(*) as total_events,
    SUM(original_size) as total_original,
    SUM(compressed_size) as total_compressed,
    ROUND(100 - (SUM(compressed_size) / SUM(original_size) * 100), 2) as compression_ratio
FROM information_schema.binlog_events 
WHERE compression_type != 'NONE';

-- ç›‘æ§è§£å‹é”™è¯¯
SHOW SLAVE STATUS\G
-- æŸ¥çœ‹Last_Errorå­—æ®µæ˜¯å¦æœ‰è§£å‹ç›¸å…³é”™è¯¯
```

---

## 7. ğŸŒ ç½‘ç»œå¸¦å®½èŠ‚çœæ•ˆæœ


### 7.1 å¸¦å®½èŠ‚çœè®¡ç®—


**èŠ‚çœæ•ˆæœæµ‹é‡**ï¼š
```sql
-- ç›‘æ§ç½‘ç»œä¼ è¾“é‡ï¼ˆå‹ç¼©å‰åå¯¹æ¯”ï¼‰
-- å¯ç”¨å‹ç¼©å‰çš„æµ‹é‡
SHOW STATUS LIKE 'Bytes_sent';
SHOW STATUS LIKE 'Bytes_received';

-- å¯ç”¨å‹ç¼©åçš„æµ‹é‡
-- è®¡ç®—èŠ‚çœæ¯”ä¾‹ = (å‹ç¼©å‰ - å‹ç¼©å) / å‹ç¼©å‰ * 100%
```

**å®é™…æ¡ˆä¾‹åˆ†æ**ï¼š
```
ğŸ“Š æŸç”µå•†ç½‘ç«™å¤åˆ¶ä¼˜åŒ–æ¡ˆä¾‹ï¼š

ä¼˜åŒ–å‰ï¼š
- æ—¥å‡å¤åˆ¶æ•°æ®ï¼š200GB
- ç½‘ç»œå¸¦å®½ï¼š100Mbpsä¸“çº¿
- æœˆåº¦å¸¦å®½æˆæœ¬ï¼šï¿¥5000

ä¼˜åŒ–åï¼ˆå¯ç”¨zlibå‹ç¼©ï¼‰ï¼š
- æ—¥å‡ä¼ è¾“æ•°æ®ï¼š80GBï¼ˆå‹ç¼©ç‡60%ï¼‰
- å¸¦å®½åˆ©ç”¨ç‡ï¼šä¸‹é™60%
- æœˆåº¦æˆæœ¬èŠ‚çœï¼šï¿¥2000
- å¹´åº¦èŠ‚çœï¼šï¿¥24000
```

### 7.2 ä¸åŒåœºæ™¯çš„èŠ‚çœæ•ˆæœ


**æŒ‰æ•°æ®ç±»å‹çš„èŠ‚çœæ•ˆæœ**ï¼š
```
ğŸ“ æ–‡æœ¬å¯†é›†å‹åº”ç”¨ï¼š
åŸå§‹æ•°æ®ï¼šç¤¾äº¤å¹³å°ç”¨æˆ·åŠ¨æ€
å‹ç¼©ç‡ï¼š70-80%
å¸¦å®½èŠ‚çœï¼šæ¯æœˆèŠ‚çœæ•°TBä¼ è¾“

ğŸ“Š æ—¥å¿—ç³»ç»Ÿï¼š
åŸå§‹æ•°æ®ï¼šåº”ç”¨è®¿é—®æ—¥å¿—
å‹ç¼©ç‡ï¼š80-90%
å¸¦å®½èŠ‚çœï¼šæ˜¾è‘—ï¼Œç‰¹åˆ«æ˜¯é‡å¤å­—æ®µå¤š

ğŸ›’ ç”µå•†äº¤æ˜“ï¼š
åŸå§‹æ•°æ®ï¼šè®¢å•ã€å•†å“ä¿¡æ¯
å‹ç¼©ç‡ï¼š50-70%
å¸¦å®½èŠ‚çœï¼šä¸­ç­‰ï¼Œæ··åˆæ•°æ®ç±»å‹

ğŸ“± å¤šåª’ä½“åº”ç”¨ï¼š
åŸå§‹æ•°æ®ï¼šå›¾ç‰‡ã€è§†é¢‘å…ƒæ•°æ®
å‹ç¼©ç‡ï¼š20-40%
å¸¦å®½èŠ‚çœï¼šæœ‰é™ï¼ŒäºŒè¿›åˆ¶æ•°æ®è¾ƒå¤š
```

### 7.3 æˆæœ¬æ•ˆç›Šåˆ†æ


**æˆæœ¬æ•ˆç›Šè®¡ç®—å…¬å¼**ï¼š
```
ğŸ’° æˆæœ¬æ•ˆç›Šåˆ†æï¼š

æœˆåº¦å¸¦å®½èŠ‚çœ = åŸå§‹æµé‡ Ã— å‹ç¼©ç‡ Ã— å•ä½å¸¦å®½æˆæœ¬
CPUæˆæœ¬å¢åŠ  = é¢å¤–CPUä½¿ç”¨ Ã— CPUèµ„æºæˆæœ¬
å‡€æ”¶ç›Š = å¸¦å®½èŠ‚çœ - CPUæˆæœ¬å¢åŠ 

ç¤ºä¾‹è®¡ç®—ï¼š
åŸå§‹æµé‡ï¼š1000GB/æœˆ
å‹ç¼©ç‡ï¼š60%
å¸¦å®½æˆæœ¬ï¼šï¿¥0.5/GB
CPUæˆæœ¬å¢åŠ ï¼šï¿¥100/æœˆ

æœˆåº¦æ”¶ç›Šï¼š
å¸¦å®½èŠ‚çœï¼š1000 Ã— 0.6 Ã— 0.5 = ï¿¥300
CPUæˆæœ¬ï¼šï¿¥100
å‡€æ”¶ç›Šï¼š300 - 100 = ï¿¥200/æœˆ
```

**ROIåˆ†æ**ï¼š
```
ğŸ¯ æŠ•èµ„å›æŠ¥ç‡è¯„ä¼°ï¼š

é«˜æ”¶ç›Šåœºæ™¯ï¼š
- è·¨åœ°åŸŸå¤åˆ¶
- å¸¦å®½æˆæœ¬é«˜
- æ•°æ®æ–‡æœ¬åŒ–ç¨‹åº¦é«˜
- ROI > 300%

ä¸­ç­‰æ”¶ç›Šåœºæ™¯ï¼š
- åŒåŸè·¨æœºæˆ¿
- ä¸­ç­‰å¸¦å®½æˆæœ¬
- æ··åˆæ•°æ®ç±»å‹
- ROI: 100-300%

ä½æ”¶ç›Šåœºæ™¯ï¼š
- å±€åŸŸç½‘å¤åˆ¶
- å¸¦å®½æˆæœ¬ä½
- äºŒè¿›åˆ¶æ•°æ®å¤š
- ROI < 100%
```

---

## 8. ğŸ› ï¸ å‹ç¼©æ•…éšœå¤„ç†æŒ‡å—


### 8.1 å¸¸è§å‹ç¼©æ•…éšœç±»å‹


**å‹ç¼©é…ç½®æ•…éšœ**ï¼š
```sql
-- æ•…éšœ1ï¼šå‹ç¼©æ— æ³•å¯ç”¨
-- ç—‡çŠ¶ï¼šè®¾ç½®å‹ç¼©å‚æ•°åä»æ— å‹ç¼©æ•ˆæœ

-- æ£€æŸ¥æ–¹æ³•ï¼š
SHOW VARIABLES LIKE '%compression%';
SHOW STATUS LIKE '%compression%';

-- å¯èƒ½åŸå› ï¼š
-- 1. MySQLç‰ˆæœ¬ä¸æ”¯æŒï¼ˆéœ€è¦8.0.20+æ”¯æŒæ–°ç®—æ³•ï¼‰
-- 2. äº‹åŠ¡å¤§å°ä½äºå‹ç¼©é˜ˆå€¼
-- 3. ä»åº“ç‰ˆæœ¬å¤ªè€æ— æ³•è¯†åˆ«

-- è§£å†³æ–¹æ¡ˆï¼š
-- æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
SELECT VERSION();
-- è°ƒæ•´å‹ç¼©é˜ˆå€¼
SET GLOBAL binlog_transaction_compression_threshold = 100;
```

**å‹ç¼©ç®—æ³•æ•…éšœ**ï¼š
```sql
-- æ•…éšœ2ï¼šç®—æ³•ä¸æ”¯æŒé”™è¯¯
-- é”™è¯¯ä¿¡æ¯ï¼šUnknown compression algorithm 'zstd'

-- æ£€æŸ¥æ”¯æŒçš„ç®—æ³•ï¼š
SHOW VARIABLES LIKE 'binlog_transaction_compression_algorithm';

-- è§£å†³æ–¹æ¡ˆï¼š
-- é™çº§åˆ°å…¼å®¹çš„ç®—æ³•
SET GLOBAL binlog_transaction_compression_algorithm = 'zlib';
```

### 8.2 è§£å‹ç¼©æ•…éšœè¯Šæ–­


**è§£å‹å¤±è´¥å¤„ç†**ï¼š
```sql
-- æ•…éšœ3ï¼šä»åº“è§£å‹å¤±è´¥
-- æ£€æŸ¥ä»åº“çŠ¶æ€
SHOW SLAVE STATUS\G

-- å…³é”®å­—æ®µæ£€æŸ¥ï¼š
-- Last_Error: æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
-- Slave_SQL_Running: æ˜¯å¦å› è§£å‹é”™è¯¯åœæ­¢

-- å¸¸è§é”™è¯¯å’Œå¤„ç†ï¼š
-- Error 1: Binlog decompression failed
-- å¤„ç†ï¼šæ£€æŸ¥ç½‘ç»œä¼ è¾“ï¼Œé‡å¯å¤åˆ¶

-- Error 2: Out of memory during decompression  
-- å¤„ç†ï¼šå¢åŠ ä»åº“å†…å­˜ï¼Œé™ä½å‹ç¼©çº§åˆ«

-- é‡å¯å¤åˆ¶ï¼š
STOP SLAVE;
START SLAVE;
```

**æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥**ï¼š
```sql
-- éªŒè¯å‹ç¼©å¤åˆ¶çš„æ•°æ®ä¸€è‡´æ€§
-- ä¸»åº“æ£€æŸ¥
SELECT COUNT(*) as master_count FROM important_table;
SHOW MASTER STATUS;

-- ä»åº“æ£€æŸ¥  
SELECT COUNT(*) as slave_count FROM important_table;
SHOW SLAVE STATUS\G

-- æ•°æ®æ ¡éªŒå·¥å…·
-- ä½¿ç”¨pt-table-checksuméªŒè¯
pt-table-checksum --host=master_host --replicate=test.checksum
```

### 8.3 æ€§èƒ½é—®é¢˜æ’æŸ¥


**å‹ç¼©æ€§èƒ½é—®é¢˜**ï¼š
```sql
-- é—®é¢˜ï¼šå‹ç¼©å¯¼è‡´å¤åˆ¶å»¶è¿Ÿå¢åŠ 
-- æ’æŸ¥æ­¥éª¤ï¼š

-- 1. æ£€æŸ¥å‹ç¼©æ¯”ä¾‹å’ŒCPUä½¿ç”¨
SHOW PROCESSLIST;
SHOW STATUS LIKE 'Com_binlog%';

-- 2. ç›‘æ§å¤åˆ¶å»¶è¿Ÿ
SHOW SLAVE STATUS\G
-- é‡ç‚¹å…³æ³¨ï¼šSeconds_Behind_Master

-- 3. åˆ†æå‹ç¼©æ•ˆæœ
SELECT 
    event_type,
    AVG(original_size) as avg_original,
    AVG(compressed_size) as avg_compressed,
    ROUND(100 - (AVG(compressed_size) / AVG(original_size) * 100), 2) as avg_compression
FROM binlog_compression_stats 
GROUP BY event_type;
```

**ä¼˜åŒ–å»ºè®®**ï¼š
```
ğŸ”§ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š

CPUä½¿ç”¨ç‡è¿‡é«˜ï¼š
- é™ä½å‹ç¼©çº§åˆ«
- åˆ‡æ¢åˆ°lz4ç®—æ³•
- å¢åŠ å‹ç¼©é˜ˆå€¼

å¤åˆ¶å»¶è¿Ÿå¢åŠ ï¼š
- æ£€æŸ¥ç½‘ç»œè´¨é‡
- è°ƒæ•´å‹ç¼©é˜ˆå€¼
- è€ƒè™‘å…³é—­å‹ç¼©

å†…å­˜ä½¿ç”¨è¿‡å¤šï¼š
- é™ä½å‹ç¼©çº§åˆ«
- å‡å°‘å¹¶è¡Œå¤åˆ¶çº¿ç¨‹
- å¢åŠ æœåŠ¡å™¨å†…å­˜
```

### 8.4 æ•…éšœé¢„é˜²æªæ–½


**ç›‘æ§å‘Šè­¦è®¾ç½®**ï¼š
```sql
-- è®¾ç½®å…³é”®ç›‘æ§æŒ‡æ ‡

-- 1. å‹ç¼©ç‡ç›‘æ§
-- å½“å‹ç¼©ç‡ä½äº30%æ—¶å‘Šè­¦ï¼ˆå¯èƒ½æ˜¯å‹ç¼©æ— æ•ˆï¼‰

-- 2. å¤åˆ¶å»¶è¿Ÿç›‘æ§  
-- å½“Seconds_Behind_Master > 60æ—¶å‘Šè­¦

-- 3. è§£å‹é”™è¯¯ç›‘æ§
-- ç›‘æ§Last_Errorå­—æ®µä¸­çš„å‹ç¼©ç›¸å…³é”™è¯¯

-- 4. CPUä½¿ç”¨ç‡ç›‘æ§
-- å‹ç¼©ç›¸å…³çš„CPUä½¿ç”¨ç‡ç›‘æ§
```

**å®šæœŸæ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# å‹ç¼©å¤åˆ¶å¥åº·æ£€æŸ¥è„šæœ¬

# æ£€æŸ¥å‹ç¼©é…ç½®
mysql -e "SELECT 
    $$binlog_transaction_compression as compression_enabled,
    $$binlog_transaction_compression_algorithm as algorithm,
    $$binlog_transaction_compression_threshold as threshold;"

# æ£€æŸ¥å¤åˆ¶çŠ¶æ€
mysql -e "SHOW SLAVE STATUS\G" | grep -E "(Running|Behind|Error)"

# æ£€æŸ¥å‹ç¼©æ•ˆæœ
mysql -e "SHOW STATUS LIKE '%compression%';"
```

---

## 9. ğŸ“ˆ å‹ç¼©ç›‘æ§æŒ‡æ ‡è¯¦è§£


### 9.1 æ ¸å¿ƒç›‘æ§æŒ‡æ ‡


**å‹ç¼©æ•ˆæœæŒ‡æ ‡**ï¼š
```sql
-- ç›‘æ§å‹ç¼©ç›¸å…³çš„çŠ¶æ€å˜é‡
SHOW STATUS LIKE 'Binlog_transaction_compression%';

-- å…³é”®æŒ‡æ ‡è¯´æ˜ï¼š
-- Binlog_transaction_compression_bytes_written: å‹ç¼©åå†™å…¥å­—èŠ‚æ•°
-- Binlog_transaction_compression_bytes_uncompressed: å‹ç¼©å‰å­—èŠ‚æ•°
-- Binlog_transaction_compression_events: å‹ç¼©äº‹ä»¶æ€»æ•°
```

**æ€§èƒ½ç›‘æ§æŒ‡æ ‡**ï¼š
```sql
-- CPUä½¿ç”¨ç‡ç›¸å…³
SHOW PROCESSLIST;
-- æŸ¥çœ‹æ˜¯å¦æœ‰é•¿æ—¶é—´çš„å‹ç¼©æ“ä½œ

-- å¤åˆ¶å»¶è¿Ÿç›‘æ§
SHOW SLAVE STATUS\G
-- é‡ç‚¹å…³æ³¨ï¼š
-- Seconds_Behind_Master: å¤åˆ¶å»¶è¿Ÿç§’æ•°
-- Relay_Log_Space: ä¸­ç»§æ—¥å¿—ä½¿ç”¨ç©ºé—´

-- ç½‘ç»œIOç›‘æ§
SHOW STATUS LIKE 'Bytes_sent';
SHOW STATUS LIKE 'Bytes_received';
```

### 9.2 ç›‘æ§æŒ‡æ ‡è®¡ç®—


**å‹ç¼©ç‡è®¡ç®—**ï¼š
```sql
-- å®æ—¶å‹ç¼©ç‡è®¡ç®—
SELECT 
    ROUND(
        100 - (
            (SELECT VARIABLE_VALUE FROM performance_schema.global_status 
             WHERE VARIABLE_NAME = 'Binlog_transaction_compression_bytes_written') /
            (SELECT VARIABLE_VALUE FROM performance_schema.global_status 
             WHERE VARIABLE_NAME = 'Binlog_transaction_compression_bytes_uncompressed') * 100
        ), 2
    ) as current_compression_ratio;
```

**ç½‘ç»œå¸¦å®½èŠ‚çœè®¡ç®—**ï¼š
```sql
-- å¸¦å®½èŠ‚çœé‡è®¡ç®—ï¼ˆéœ€è¦è®°å½•å‹ç¼©å‰åçš„æ•°æ®ï¼‰
SELECT 
    uncompressed_bytes,
    compressed_bytes,
    (uncompressed_bytes - compressed_bytes) as bytes_saved,
    ROUND((uncompressed_bytes - compressed_bytes) / uncompressed_bytes * 100, 2) as save_percentage
FROM (
    SELECT 
        (SELECT VARIABLE_VALUE FROM performance_schema.global_status 
         WHERE VARIABLE_NAME = 'Binlog_transaction_compression_bytes_uncompressed') as uncompressed_bytes,
        (SELECT VARIABLE_VALUE FROM performance_schema.global_status 
         WHERE VARIABLE_NAME = 'Binlog_transaction_compression_bytes_written') as compressed_bytes
) as compression_stats;
```

### 9.3 ç›‘æ§å·¥å…·é›†æˆ


**Prometheusç›‘æ§é…ç½®**ï¼š
```yaml
# MySQLå‹ç¼©æŒ‡æ ‡æ”¶é›†é…ç½®
- job_name: 'mysql-compression'
  static_configs:
  - targets: ['mysql-master:3306']
  metrics_path: /metrics
  params:
    collect[]:
    - info_schema.processlist
    - global_status
    - binlog_size
```

**ç›‘æ§æŸ¥è¯¢ç¤ºä¾‹**ï¼š
```sql
-- å¯ç”¨äºGrafanaç­‰ç›‘æ§å·¥å…·çš„æŸ¥è¯¢

-- 1. å‹ç¼©ç‡è¶‹åŠ¿
SELECT 
    NOW() as time,
    ROUND(100 - (compressed/uncompressed * 100), 2) as compression_ratio
FROM (
    SELECT 
        CAST(VARIABLE_VALUE AS UNSIGNED) as compressed
    FROM performance_schema.global_status 
    WHERE VARIABLE_NAME = 'Binlog_transaction_compression_bytes_written'
) c,
(
    SELECT 
        CAST(VARIABLE_VALUE AS UNSIGNED) as uncompressed
    FROM performance_schema.global_status 
    WHERE VARIABLE_NAME = 'Binlog_transaction_compression_bytes_uncompressed'  
) u;

-- 2. å¤åˆ¶å»¶è¿Ÿç›‘æ§
SHOW SLAVE STATUS\G
```

### 9.4 å‘Šè­¦è§„åˆ™è®¾ç½®


**å…³é”®å‘Šè­¦æŒ‡æ ‡**ï¼š
```
ğŸš¨ é‡è¦å‘Šè­¦è§„åˆ™ï¼š

1. å‹ç¼©ç‡å¼‚å¸¸ï¼š
   æŒ‡æ ‡ï¼šcompression_ratio < 20%
   å«ä¹‰ï¼šå‹ç¼©æ•ˆæœå¾ˆå·®ï¼Œå¯èƒ½é…ç½®æœ‰é—®é¢˜
   å¤„ç†ï¼šæ£€æŸ¥æ•°æ®ç±»å‹å’Œå‹ç¼©é˜ˆå€¼

2. å¤åˆ¶å»¶è¿Ÿå¢åŠ ï¼š
   æŒ‡æ ‡ï¼šSeconds_Behind_Master > 300
   å«ä¹‰ï¼šå‹ç¼©å¯èƒ½å¯¼è‡´å¤åˆ¶å˜æ…¢
   å¤„ç†ï¼šè€ƒè™‘è°ƒæ•´å‹ç¼©ç®—æ³•æˆ–çº§åˆ«

3. è§£å‹é”™è¯¯ï¼š
   æŒ‡æ ‡ï¼šLast_ErroråŒ…å«"compression"
   å«ä¹‰ï¼šè§£å‹è¿‡ç¨‹å‡ºç°é”™è¯¯
   å¤„ç†ï¼šæ£€æŸ¥ä»åº“çŠ¶æ€å’Œç½‘ç»œè¿æ¥

4. CPUä½¿ç”¨ç‡è¿‡é«˜ï¼š
   æŒ‡æ ‡ï¼šcompression_cpu_usage > 80%
   å«ä¹‰ï¼šå‹ç¼©æ¶ˆè€—è¿‡å¤šCPUèµ„æº
   å¤„ç†ï¼šé™ä½å‹ç¼©çº§åˆ«æˆ–åˆ‡æ¢ç®—æ³•
```

**ç›‘æ§è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# MySQLå‹ç¼©ç›‘æ§è„šæœ¬

# è·å–å‹ç¼©ç‡
compression_ratio=$(mysql -N -e "
SELECT ROUND(100 - (
    (SELECT VARIABLE_VALUE FROM performance_schema.global_status 
     WHERE VARIABLE_NAME = 'Binlog_transaction_compression_bytes_written') /
    (SELECT VARIABLE_VALUE FROM performance_schema.global_status 
     WHERE VARIABLE_NAME = 'Binlog_transaction_compression_bytes_uncompressed') * 100
), 2);")

# æ£€æŸ¥å‹ç¼©ç‡å‘Šè­¦
if [ $(echo "$compression_ratio < 20" | bc) -eq 1 ]; then
    echo "WARNING: Low compression ratio: $compression_ratio%"
    # å‘é€å‘Šè­¦é€šçŸ¥
fi

# æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
lag=$(mysql -N -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master:" | awk '{print $2}')
if [ "$lag" -gt 300 ]; then
    echo "WARNING: High replication lag: $lag seconds"
    # å‘é€å‘Šè­¦é€šçŸ¥
fi
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å‹ç¼©æœ¬è´¨ï¼šå‡å°‘ç½‘ç»œä¼ è¾“æ•°æ®é‡ï¼Œæé«˜å¤åˆ¶æ•ˆç‡
ğŸ”¸ ç®—æ³•é€‰æ‹©ï¼šzlibç¨³å®šé€šç”¨ï¼Œlz4å¿«é€Ÿä½è€—ï¼Œzstdé«˜å‹ç¼©ç‡
ğŸ”¸ æ€§èƒ½æƒè¡¡ï¼šCPUæ¶ˆè€— vs ç½‘ç»œå¸¦å®½èŠ‚çœçš„å¹³è¡¡
ğŸ”¸ é…ç½®å…³é”®ï¼šå‹ç¼©é˜ˆå€¼ã€ç®—æ³•ç±»å‹ã€å‹ç¼©çº§åˆ«
ğŸ”¸ ç›‘æ§é‡ç‚¹ï¼šå‹ç¼©ç‡ã€å¤åˆ¶å»¶è¿Ÿã€CPUä½¿ç”¨ã€è§£å‹é”™è¯¯
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å‹ç¼©**ï¼š
```
é€‚åˆåœºæ™¯ï¼š
- è·¨åœ°åŸŸå¤åˆ¶ï¼Œç½‘ç»œå¸¦å®½å—é™
- æ•°æ®ä»¥æ–‡æœ¬ä¸ºä¸»ï¼Œé‡å¤æ€§é«˜
- å¸¦å®½æˆæœ¬é«˜ï¼ŒCPUèµ„æºå……è¶³
- å¤åˆ¶æ•°æ®é‡å¤§ï¼Œä¼ è¾“é¢‘ç¹

ä¸é€‚åˆåœºæ™¯ï¼š
- å±€åŸŸç½‘å¤åˆ¶ï¼Œç½‘ç»œé€Ÿåº¦å¾ˆå¿«
- æ•°æ®ä»¥äºŒè¿›åˆ¶ä¸ºä¸»ï¼Œå·²ç»å‹ç¼©
- CPUèµ„æºç´§å¼ ï¼Œæ€§èƒ½è¦æ±‚é«˜
- æ•°æ®é‡å°ï¼Œå‹ç¼©æ”¶ç›Šä¸å¤§
```

**ğŸ”¹ å¦‚ä½•é€‰æ‹©å‹ç¼©ç®—æ³•**ï¼š
```
zlibç®—æ³•ï¼š
- æœ€ä½³é€šç”¨é€‰æ‹©ï¼Œå…¼å®¹æ€§å¥½
- å‹ç¼©ç‡å’Œæ€§èƒ½å¹³è¡¡
- é€‚åˆå¤§å¤šæ•°ç”Ÿäº§ç¯å¢ƒ

lz4ç®—æ³•ï¼š
- è¿½æ±‚æè‡´æ€§èƒ½æ—¶é€‰æ‹©
- CPUæ¶ˆè€—æœ€ä½ï¼Œé€Ÿåº¦æœ€å¿«
- é€‚åˆå®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯

zstdç®—æ³•ï¼š
- ç½‘ç»œå¸¦å®½æå…¶å®è´µæ—¶é€‰æ‹©
- å‹ç¼©ç‡æœ€é«˜ï¼Œä½†CPUæ¶ˆè€—è¾ƒå¤§
- é€‚åˆè·¨å›½å¤åˆ¶ç­‰é«˜æˆæœ¬åœºæ™¯
```

**ğŸ”¹ é…ç½®ä¼˜åŒ–ç­–ç•¥**ï¼š
```
åŸºç¡€é…ç½®ï¼š
- å¯ç”¨å‹ç¼©ï¼šbinlog_transaction_compression = ON
- é€‰æ‹©ç®—æ³•ï¼šæ¨èzlibæˆ–lz4
- è®¾ç½®é˜ˆå€¼ï¼š256å­—èŠ‚æ˜¯å¥½çš„èµ·ç‚¹

æ€§èƒ½è°ƒä¼˜ï¼š
- ç›‘æ§å‹ç¼©ç‡ï¼šåº”è¯¥åœ¨30%ä»¥ä¸Š
- å…³æ³¨CPUä½¿ç”¨ï¼šä¸åº”è¶…è¿‡æ€»CPUçš„15%
- è§‚å¯Ÿå¤åˆ¶å»¶è¿Ÿï¼šä¸åº”æ˜æ˜¾å¢åŠ 
- å®šæœŸæ£€æŸ¥é”™è¯¯ï¼šé¿å…è§£å‹å¤±è´¥
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’° æˆæœ¬æ•ˆç›Š**ï¼š
- **ç½‘ç»œæˆæœ¬èŠ‚çœ**ï¼šè·¨åœ°åŸŸå¤åˆ¶å¯èŠ‚çœ50-80%å¸¦å®½è´¹ç”¨
- **ä¼ è¾“æ•ˆç‡æå‡**ï¼šæ•°æ®ä¼ è¾“é€Ÿåº¦æå‡30-200%
- **CPUæˆæœ¬å¢åŠ **ï¼šé€šå¸¸å¢åŠ 5-15%çš„CPUä½¿ç”¨
- **æ•´ä½“ROI**ï¼šç½‘ç»œå—é™ç¯å¢ƒä¸‹é€šå¸¸>200%

**ğŸ“Š æ€§èƒ½å½±å“**ï¼š
- **æ­£é¢å½±å“**ï¼šå‡å°‘ç½‘ç»œIOï¼Œæé«˜ä¼ è¾“é€Ÿåº¦
- **è´Ÿé¢å½±å“**ï¼šå¢åŠ CPUè®¡ç®—ï¼Œè½»å¾®å¢åŠ å»¶è¿Ÿ  
- **å‡€æ•ˆæœ**ï¼šç½‘ç»œå—é™æ—¶æ•´ä½“æ€§èƒ½æå‡æ˜æ˜¾

**ğŸ› ï¸ è¿ç»´ä»·å€¼**ï¼š
- **é™ä½å¤æ‚åº¦**ï¼šMySQLå†…ç½®åŠŸèƒ½ï¼Œé…ç½®ç®€å•
- **æé«˜ç¨³å®šæ€§**ï¼šå‡å°‘ç½‘ç»œä¼ è¾“æ•…éšœæ¦‚ç‡
- **ä¾¿äºç›‘æ§**ï¼šä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡å’ŒçŠ¶æ€å˜é‡
- **æ•…éšœæ¢å¤**ï¼šå‹ç¼©ä¸å½±å“æ•°æ®ä¸€è‡´æ€§

### 10.4 æœ€ä½³å®è·µå»ºè®®


```
ğŸ¯ éƒ¨ç½²å»ºè®®ï¼š

1. åˆ†é˜¶æ®µå®æ–½ï¼š
   - å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ•ˆæœ
   - é€æ­¥åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨
   - æŒç»­ç›‘æ§å’Œä¼˜åŒ–

2. ç›‘æ§å‘Šè­¦ï¼š
   - è®¾ç½®å‹ç¼©ç‡ä½äº30%çš„å‘Šè­¦
   - ç›‘æ§å¤åˆ¶å»¶è¿Ÿå˜åŒ–
   - å…³æ³¨CPUä½¿ç”¨ç‡å¢é•¿

3. æ•…éšœé¢„æ¡ˆï¼š
   - å‡†å¤‡å¿«é€Ÿå…³é—­å‹ç¼©çš„æ–¹æ¡ˆ
   - å»ºç«‹å‹ç¼©æ•…éšœå¤„ç†æµç¨‹
   - å®šæœŸæ£€æŸ¥å‹ç¼©å¥åº·çŠ¶æ€

4. æŒç»­ä¼˜åŒ–ï¼š
   - æ ¹æ®ä¸šåŠ¡æ•°æ®ç‰¹ç‚¹è°ƒæ•´ç®—æ³•
   - å®šæœŸè¯„ä¼°å‹ç¼©æ•ˆæœå’Œæˆæœ¬
   - è·Ÿè¿›MySQLç‰ˆæœ¬æ–°ç‰¹æ€§
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- å‹ç¼©å¤åˆ¶çœå¸¦å®½ï¼Œç½‘ç»œå—é™æ•ˆæœä½³
- ç®—æ³•é€‰æ‹©çœ‹åœºæ™¯ï¼Œæ€§èƒ½å¸¦å®½è¦å¹³è¡¡  
- é…ç½®ç›‘æ§ä¸¤æ‰‹æŠ“ï¼Œæ•…éšœé¢„é˜²ä¸å¯å°‘
- æˆæœ¬æ•ˆç›Šç®—æ¸…æ¥šï¼ŒæŒç»­ä¼˜åŒ–æ˜¯å…³é”®