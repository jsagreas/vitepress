---
title: 9ã€GTIDç©ºæ´å¤„ç†
---
## ğŸ“š ç›®å½•

1. [GTIDç©ºæ´åŸºç¡€æ¦‚å¿µ](#1-GTIDç©ºæ´åŸºç¡€æ¦‚å¿µ)
2. [GTIDç©ºæ´çš„æˆå› åˆ†æ](#2-GTIDç©ºæ´çš„æˆå› åˆ†æ)
3. [GTIDç©ºæ´æ£€æµ‹æ–¹æ³•](#3-GTIDç©ºæ´æ£€æµ‹æ–¹æ³•)
4. [GTIDç©ºæ´ä¿®å¤ç­–ç•¥](#4-GTIDç©ºæ´ä¿®å¤ç­–ç•¥)
5. [GTIDäº‹åŠ¡è·³è¿‡æœºåˆ¶](#5-GTIDäº‹åŠ¡è·³è¿‡æœºåˆ¶)
6. [ç©ºæ´é¢„é˜²ä¸ç›‘æ§](#6-ç©ºæ´é¢„é˜²ä¸ç›‘æ§)
7. [ç©ºæ´å¤„ç†çš„ä¸šåŠ¡å½±å“æ§åˆ¶](#7-ç©ºæ´å¤„ç†çš„ä¸šåŠ¡å½±å“æ§åˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ GTIDç©ºæ´åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯GTIDç©ºæ´


**ç®€å•ç†è§£**ï¼šGTIDç©ºæ´å°±åƒå›¾ä¹¦é¦†é‡Œä¹¦ç±ç¼–å·çš„"è·³å·"ç°è±¡

```
æ­£å¸¸GTIDåºåˆ—ï¼š
server_uuid:1, server_uuid:2, server_uuid:3, server_uuid:4, server_uuid:5

å­˜åœ¨ç©ºæ´çš„GTIDåºåˆ—ï¼š
server_uuid:1, server_uuid:2, [ç©ºæ´], server_uuid:4, server_uuid:5
                          â†‘
                    ç¼ºå°‘ç¼–å·3çš„äº‹åŠ¡
```

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
GTIDç©ºæ´ï¼šåœ¨GTIDåºåˆ—ä¸­ç¼ºå¤±çš„äº‹åŠ¡ç¼–å·ï¼Œå½¢æˆä¸è¿ç»­çš„äº‹åŠ¡åºåˆ—
è¡¨ç°å½¢å¼ï¼š$$gtid_executedä¸­æŸäº›ç¼–å·æ®µçš„ç¼ºå¤±
å½±å“èŒƒå›´ï¼šä¸»ä»å¤åˆ¶çš„è¿ç»­æ€§å’Œä¸€è‡´æ€§
```

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> å°±åƒå¿«é€’åŒ…è£¹ç¼–å·ï¼Œå¦‚æœ1ã€2ã€4ã€5éƒ½åˆ°äº†ï¼Œä½†3å·åŒ…è£¹ä¸¢å¤±äº†ï¼Œè¿™ä¸ª"3"å°±æ˜¯ç©ºæ´ã€‚MySQLéœ€è¦çŸ¥é“è¿™ä¸ªåŒ…è£¹æ˜¯çœŸçš„ä¸¢äº†è¿˜æ˜¯è¿˜åœ¨è·¯ä¸Šã€‚

### 1.2 GTIDç©ºæ´çš„è¡¨ç°å½¢å¼


**ğŸ“Š å…¸å‹ç©ºæ´åœºæ™¯å±•ç¤º**
```
æŸ¥çœ‹å½“å‰GTIDæ‰§è¡ŒçŠ¶æ€ï¼š
mysql> SHOW GLOBAL VARIABLES LIKE 'gtid_executed'\G

æ­£å¸¸æƒ…å†µï¼š
gtid_executed: 3E11FA47-71CA-11E1-9E33-C80AA9429562:1-100

å­˜åœ¨ç©ºæ´ï¼š
gtid_executed: 3E11FA47-71CA-11E1-9E33-C80AA9429562:1-50:52-100
                                                    â†‘
                                              ç¼ºå¤±äº‹åŠ¡51
```

**ğŸ” ç©ºæ´è¯†åˆ«ç‰¹å¾**
- **è¿ç»­æ€§æ–­è£‚**ï¼šGTIDåºåˆ—ä¸­å‡ºç°è·³è·ƒ
- **èŒƒå›´åˆ†å‰²**ï¼šåŸæœ¬è¿ç»­çš„èŒƒå›´è¢«åˆ†æˆå¤šæ®µ
- **å¤åˆ¶å»¶è¿Ÿ**ï¼šä»åº“ç­‰å¾…ç¼ºå¤±çš„GTIDäº‹åŠ¡

### 1.3 GTIDç©ºæ´çš„å±å®³å½±å“


**âš ï¸ å¯¹å¤åˆ¶ç³»ç»Ÿçš„å½±å“**

| å½±å“æ–¹é¢ | **å…·ä½“è¡¨ç°** | **ä¸¥é‡ç¨‹åº¦** | **è§£å†³ç´§æ€¥æ€§** |
|---------|-------------|-------------|---------------|
| ğŸ”„ **å¤åˆ¶ä¸­æ–­** | `ä»åº“ç­‰å¾…ç¼ºå¤±GTIDï¼Œå¤åˆ¶åœæ­¢` | `ğŸ”´ ä¸¥é‡` | `ç«‹å³å¤„ç†` |
| ğŸ“Š **æ•°æ®ä¸€è‡´æ€§** | `ä¸»ä»æ•°æ®å¯èƒ½ä¸ä¸€è‡´` | `ğŸ”´ ä¸¥é‡` | `ç«‹å³éªŒè¯` |
| âš¡ **æ€§èƒ½ä¸‹é™** | `å¤åˆ¶çº¿ç¨‹ç­‰å¾…ï¼Œååé‡é™ä½` | `ğŸŸ¡ ä¸­ç­‰` | `ç›‘æ§å¤„ç†` |
| ğŸ”§ **è¿ç»´å¤æ‚** | `æ•…éšœæ’æŸ¥å’Œä¿®å¤æˆæœ¬å¢åŠ ` | `ğŸŸ¡ ä¸­ç­‰` | `ä¼˜åŒ–æµç¨‹` |

**ğŸš¨ ä¸šåŠ¡å½±å“ç¤ºä¾‹**
```
åœºæ™¯ï¼šç”µå•†è®¢å•ç³»ç»Ÿ
ä¸»åº“äº‹åŠ¡ï¼šè®¢å•åˆ›å»º(GTID:101) â†’ åº“å­˜æ‰£å‡(GTID:102) â†’ æ”¯ä»˜å¤„ç†(GTID:103)

å¦‚æœGTID:102ä¸¢å¤±ï¼š
ä¸»åº“çŠ¶æ€ï¼šè®¢å•å·²åˆ›å»ºï¼Œåº“å­˜å·²æ‰£å‡ï¼Œæ”¯ä»˜å·²å®Œæˆ
ä»åº“çŠ¶æ€ï¼šè®¢å•å·²åˆ›å»ºï¼Œç­‰å¾…GTID:102ï¼Œæ”¯ä»˜æœªå¤„ç†
ç»“æœï¼šä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Œä¸šåŠ¡é€»è¾‘é”™ä¹±
```

---

## 2. ğŸ” GTIDç©ºæ´çš„æˆå› åˆ†æ


### 2.1 äº‹åŠ¡æ‰§è¡Œå¤±è´¥å¯¼è‡´çš„ç©ºæ´


**ğŸ’¡ æœ€å¸¸è§çš„ç©ºæ´æˆå› **

```
ç©ºæ´äº§ç”Ÿè¿‡ç¨‹ï¼š
1. MySQLåˆ†é…GTIDï¼šserver_uuid:100
2. äº‹åŠ¡å¼€å§‹æ‰§è¡Œ
3. æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼ˆå¦‚çº¦æŸå†²çªã€ç£ç›˜æ»¡ç­‰ï¼‰
4. äº‹åŠ¡å›æ»šï¼Œä½†GTID:100å·²è¢«æ¶ˆè€—
5. ä¸‹ä¸€ä¸ªæˆåŠŸäº‹åŠ¡è·å¾—GTID:101
6. ç»“æœï¼šGTID:100æˆä¸ºç©ºæ´
```

**ğŸ“‹ å¸¸è§å¤±è´¥åŸå› **
```
ğŸ”¸ çº¦æŸè¿åï¼š
- ä¸»é”®å†²çªï¼šINSERTæ—¶ä¸»é”®é‡å¤
- å¤–é”®çº¦æŸï¼šè¿åå‚ç…§å®Œæ•´æ€§
- å”¯ä¸€ç´¢å¼•å†²çªï¼šUNIQUE KEYé‡å¤

ğŸ”¸ ç³»ç»Ÿèµ„æºé—®é¢˜ï¼š
- ç£ç›˜ç©ºé—´ä¸è¶³
- å†…å­˜ä¸å¤Ÿç”¨
- è¿æ¥è¶…æ—¶

ğŸ”¸ æ•°æ®ç±»å‹é”™è¯¯ï¼š
- æ•°æ®æˆªæ–­
- ç±»å‹è½¬æ¢å¤±è´¥
- é•¿åº¦è¶…é™
```

### 2.2 ä¸»ä»åˆ‡æ¢å¼•èµ·çš„ç©ºæ´


**ğŸ”„ åˆ‡æ¢è¿‡ç¨‹ä¸­çš„GTIDæ–­å±‚**

```
ä¸»ä»åˆ‡æ¢ç©ºæ´åœºæ™¯ï¼š
                          
åŸä¸»åº“ Master-Aï¼šGTID 1-100 â”€â”€Xâ”€â”€  (æ•…éšœ)
                              â”‚
æ–°ä¸»åº“ Master-Bï¼šGTID 1-95 â”€â”€â”€â”˜â”€â”€â”€â”€ GTID 101-105
                          
ç»“æœï¼šGTID 96-100 æˆä¸ºç©ºæ´
```

**âš ï¸ åˆ‡æ¢å¯¼è‡´ç©ºæ´çš„åŸå› **
- **å¤åˆ¶å»¶è¿Ÿ**ï¼šä»åº“æœªå®Œå…¨åŒæ­¥ä¸»åº“äº‹åŠ¡
- **å¹¶å‘äº‹åŠ¡**ï¼šä¸»åº“æ•…éšœæ—¶æœ‰æœªå®Œæˆçš„äº‹åŠ¡
- **ç½‘ç»œåˆ†åŒº**ï¼šéƒ¨åˆ†äº‹åŠ¡æœªèƒ½ä¼ æ’­åˆ°ä»åº“

### 2.3 æ‰‹åŠ¨æ“ä½œå¤±è¯¯å¯¼è‡´çš„ç©ºæ´


**ğŸ”§ äººä¸ºæ“ä½œå¼•èµ·çš„é—®é¢˜**

```sql
-- é”™è¯¯ç¤ºä¾‹ï¼šæ‰‹åŠ¨è·³è¿‡GTID
SET $$SESSION.GTID_NEXT = '3E11FA47-71CA-11E1-9E33-C80AA9429562:50';
BEGIN;
COMMIT;  -- ç©ºäº‹åŠ¡
SET $$SESSION.GTID_NEXT = 'AUTOMATIC';

-- å¦‚æœGTID:50æœ¬åº”è¯¥æ˜¯æ­£å¸¸äº‹åŠ¡ï¼Œè¿™æ ·æ“ä½œä¼šé€ æˆæ•°æ®ä¸¢å¤±
```

**ğŸ“ æ“ä½œå¤±è¯¯ç±»å‹**
- **é”™è¯¯è·³è¿‡**ï¼šè·³è¿‡äº†æœ¬åº”æ‰§è¡Œçš„æœ‰æ•ˆäº‹åŠ¡
- **é‡å¤æ³¨å…¥**ï¼šå¤šæ¬¡æ³¨å…¥ç›¸åŒGTIDçš„ç©ºäº‹åŠ¡
- **èŒƒå›´é”™è¯¯**ï¼šæ‰¹é‡æ“ä½œæ—¶æŒ‡å®šé”™è¯¯çš„GTIDèŒƒå›´

### 2.4 å¤åˆ¶æœºåˆ¶é—®é¢˜å¯¼è‡´çš„ç©ºæ´


**ğŸ”— å¤åˆ¶é“¾è·¯å¼‚å¸¸**

```
å¤åˆ¶å¼‚å¸¸å¯¼è‡´ç©ºæ´ï¼š

ä¸»åº“ï¼šTransaction GTID:200 â”€â”€â”€â”€â”€â”€â”
                                  â”‚ ç½‘ç»œå¼‚å¸¸
ä»åº“ï¼šç­‰å¾… GTID:200 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ âœ— ä¸¢å¤±

ä¸»åº“ç»§ç»­ï¼šTransaction GTID:201 â”€â”€â”
                                 â”‚ ç½‘ç»œæ¢å¤  
ä»åº“ï¼šæ¥æ”¶åˆ° GTID:201 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ âœ“ æ¥æ”¶

ç»“æœï¼šGTID:200 æˆä¸ºç©ºæ´
```

**ğŸ” å¤åˆ¶é—®é¢˜çš„å…·ä½“è¡¨ç°**
- **ç½‘ç»œæŠ–åŠ¨**ï¼šäº‹åŠ¡ä¼ è¾“ä¸­æ–­
- **IOçº¿ç¨‹å¼‚å¸¸**ï¼šå¤åˆ¶IOçº¿ç¨‹å´©æºƒé‡å¯
- **SQLçº¿ç¨‹é”™è¯¯**ï¼šæ‰§è¡Œå¤åˆ¶äº‹åŠ¡æ—¶å‡ºé”™
- **è¿‡æ»¤è§„åˆ™**ï¼šå¤åˆ¶è¿‡æ»¤å™¨é”™è¯¯é…ç½®

---

## 3. ğŸ” GTIDç©ºæ´æ£€æµ‹æ–¹æ³•


### 3.1 åŸºç¡€æ£€æµ‹æ–¹æ³•


**ğŸ“Š ä½¿ç”¨ç³»ç»Ÿå˜é‡æ£€æµ‹**

```sql
-- æŸ¥çœ‹å½“å‰æ‰§è¡Œçš„GTIDé›†åˆ
SHOW GLOBAL VARIABLES LIKE 'gtid_executed';

-- æŸ¥çœ‹å·²æ¸…ç†çš„GTIDé›†åˆ  
SHOW GLOBAL VARIABLES LIKE 'gtid_purged';

-- æŸ¥çœ‹å½“å‰å¤„ç†çš„GTID
SHOW SLAVE STATUS\G
```

**ğŸ” æ‰‹åŠ¨è¯†åˆ«ç©ºæ´æ–¹æ³•**
```sql
-- ç¤ºä¾‹ï¼šè¯†åˆ«GTIDç©ºæ´
-- gtid_executed: uuid:1-10:15-20:25-30

åˆ†æï¼š
è¿ç»­æ®µ1ï¼š1-10   (æ­£å¸¸)
è¿ç»­æ®µ2ï¼š15-20  (ç¼ºå¤±11-14)  â† ç©ºæ´1
è¿ç»­æ®µ3ï¼š25-30  (ç¼ºå¤±21-24)  â† ç©ºæ´2
```

### 3.2 è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬


**ğŸ¤– GTIDç©ºæ´æ£€æµ‹è„šæœ¬**

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import mysql.connector
import re
from typing import List, Tuple

class GTIDHoleDetector:
    def __init__(self, host: str, user: str, password: str, port: int = 3306):
        """åˆå§‹åŒ–GTIDç©ºæ´æ£€æµ‹å™¨"""
        self.config = {
            'host': host,
            'user': user, 
            'password': password,
            'port': port
        }
    
    def detect_gtid_holes(self) -> List[Tuple[str, str]]:
        """æ£€æµ‹GTIDç©ºæ´"""
        try:
            conn = mysql.connector.connect(**self.config)
            cursor = conn.cursor()
            
            # è·å–gtid_executed
            cursor.execute("SHOW GLOBAL VARIABLES LIKE 'gtid_executed'")
            result = cursor.fetchone()
            gtid_executed = result[1] if result else ""
            
            holes = self._parse_gtid_holes(gtid_executed)
            return holes
            
        except Exception as e:
            print(f"æ£€æµ‹å¤±è´¥: {e}")
            return []
        finally:
            if 'conn' in locals():
                conn.close()
    
    def _parse_gtid_holes(self, gtid_executed: str) -> List[Tuple[str, str]]:
        """è§£æGTIDå­—ç¬¦ä¸²æ‰¾å‡ºç©ºæ´"""
        holes = []
        
        # æŒ‰æœåŠ¡å™¨UUIDåˆ†ç»„
        for uuid_range in gtid_executed.split(','):
            if ':' not in uuid_range:
                continue
                
            uuid, ranges = uuid_range.split(':', 1)
            uuid = uuid.strip()
            
            # è§£æèŒƒå›´
            range_parts = ranges.split(':')
            holes.extend(self._find_holes_in_ranges(uuid, range_parts))
        
        return holes
    
    def _find_holes_in_ranges(self, uuid: str, ranges: List[str]) -> List[Tuple[str, str]]:
        """åœ¨èŒƒå›´ä¸­æ‰¾ç©ºæ´"""
        holes = []
        
        # å°†èŒƒå›´è½¬æ¢ä¸ºæ•°å­—åŒºé—´
        intervals = []
        for range_str in ranges:
            if '-' in range_str:
                start, end = map(int, range_str.split('-'))
                intervals.append((start, end))
            else:
                num = int(range_str)
                intervals.append((num, num))
        
        # æ’åºåŒºé—´
        intervals.sort()
        
        # æ£€æµ‹ç©ºæ´
        for i in range(len(intervals) - 1):
            current_end = intervals[i][1]
            next_start = intervals[i + 1][0]
            
            if current_end + 1 < next_start:
                hole_start = current_end + 1
                hole_end = next_start - 1
                holes.append((uuid, f"{hole_start}-{hole_end}"))
        
        return holes

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    detector = GTIDHoleDetector(
        host='localhost',
        user='root', 
        password='password'
    )
    
    holes = detector.detect_gtid_holes()
    
    if holes:
        print("ğŸš¨ å‘ç°GTIDç©ºæ´:")
        for uuid, hole_range in holes:
            print(f"  UUID: {uuid}")
            print(f"  ç©ºæ´èŒƒå›´: {hole_range}")
    else:
        print("âœ… æœªå‘ç°GTIDç©ºæ´")
```

### 3.3 å®æ—¶ç›‘æ§æ£€æµ‹


**ğŸ“ˆ ç›‘æ§å‘Šè­¦é…ç½®**

```sql
-- åˆ›å»ºGTIDç©ºæ´ç›‘æ§å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE CheckGTIDHoles()
BEGIN
    DECLARE gtid_executed_val TEXT;
    DECLARE hole_count INT DEFAULT 0;
    
    -- è·å–å½“å‰GTIDæ‰§è¡ŒçŠ¶æ€
    SELECT $$GLOBAL.gtid_executed INTO gtid_executed_val;
    
    -- ç®€å•æ£€æµ‹ï¼šè®¡ç®—å†’å·æ•°é‡åˆ¤æ–­æ˜¯å¦æœ‰ç©ºæ´
    -- æ­£å¸¸æƒ…å†µæ¯ä¸ªUUIDåªæœ‰ä¸€ä¸ªèŒƒå›´ï¼Œæœ‰ç©ºæ´ä¼šæœ‰å¤šä¸ªèŒƒå›´
    SET hole_count = (
        CHAR_LENGTH(gtid_executed_val) - CHAR_LENGTH(REPLACE(gtid_executed_val, ':', ''))
    ) - (
        CHAR_LENGTH(gtid_executed_val) - CHAR_LENGTH(REPLACE(gtid_executed_val, ',', ''))
    ) - (
        CHAR_LENGTH(gtid_executed_val) - CHAR_LENGTH(REPLACE(gtid_executed_val, ',', '')) + 1
    );
    
    IF hole_count > 0 THEN
        INSERT INTO gtid_hole_alerts(alert_time, gtid_executed, estimated_holes)
        VALUES(NOW(), gtid_executed_val, hole_count);
    END IF;
END //
DELIMITER ;

-- åˆ›å»ºå‘Šè­¦è¡¨
CREATE TABLE gtid_hole_alerts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    alert_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    gtid_executed TEXT,
    estimated_holes INT,
    resolved BOOLEAN DEFAULT FALSE
);
```

### 3.4 ç©ºæ´å½±å“è¯„ä¼°


**ğŸ“Š ç©ºæ´å¯¹å¤åˆ¶æ€§èƒ½çš„å½±å“åˆ†æ**

```sql
-- æ£€æŸ¥å¤åˆ¶å»¶è¿ŸçŠ¶æ€
SELECT 
    CHANNEL_NAME,
    SERVICE_STATE,
    LAST_ERROR_NUMBER,
    LAST_ERROR_MESSAGE,
    LAST_ERROR_TIMESTAMP
FROM performance_schema.replication_connection_status;

-- æ£€æŸ¥ç­‰å¾…çš„GTIDäº‹åŠ¡
SELECT 
    GTID_WAIT_FOR_EVENT,
    GTID_WAIT_STATUS,
    GTID_WAIT_TIMEOUT
FROM performance_schema.events_transactions_current
WHERE GTID_WAIT_FOR_EVENT IS NOT NULL;
```

**âš¡ æ€§èƒ½å½±å“è¯„ä¼°æ ‡å‡†**

| ç©ºæ´æ•°é‡ | **å¤åˆ¶å½±å“** | **æ€§èƒ½å½±å“** | **å¤„ç†ä¼˜å…ˆçº§** |
|---------|-------------|-------------|---------------|
| `1-5ä¸ª` | `è½»å¾®å»¶è¿Ÿ` | `< 5%æ€§èƒ½ä¸‹é™` | `ğŸŸ¡ ç›‘æ§` |
| `6-20ä¸ª` | `æ˜æ˜¾å»¶è¿Ÿ` | `5-15%æ€§èƒ½ä¸‹é™` | `ğŸŸ  è®¡åˆ’å¤„ç†` |
| `21-50ä¸ª` | `ä¸¥é‡å»¶è¿Ÿ` | `15-30%æ€§èƒ½ä¸‹é™` | `ğŸ”´ ç«‹å³å¤„ç†` |
| `> 50ä¸ª` | `å¤åˆ¶ä¸­æ–­` | `> 30%æ€§èƒ½ä¸‹é™` | `ğŸš¨ ç´§æ€¥å¤„ç†` |

---

## 4. ğŸ”§ GTIDç©ºæ´ä¿®å¤ç­–ç•¥


### 4.1 gtid_purgedè®¾ç½®æ–¹æ³•


**ğŸ¯ ä½¿ç”¨gtid_purgedè·³è¿‡ç©ºæ´**

**ğŸ“ åŸºæœ¬åŸç†**
> `gtid_purged`å°±åƒå‘Šè¯‰MySQLï¼š"è¿™äº›GTIDäº‹åŠ¡å·²ç»å¤„ç†è¿‡äº†ï¼Œä¸ç”¨å†ç­‰äº†"

```sql
-- æŸ¥çœ‹å½“å‰purgedçŠ¶æ€
SHOW GLOBAL VARIABLES LIKE 'gtid_purged';

-- è®¾ç½®gtid_purgedè·³è¿‡ç©ºæ´
-- æ³¨æ„ï¼šåªèƒ½åœ¨gtid_executedä¸ºç©ºæ—¶è®¾ç½®ï¼Œæˆ–è€…ä½¿ç”¨RESET MASTER
RESET MASTER;
SET $$GLOBAL.gtid_purged = '3E11FA47-71CA-11E1-9E33-C80AA9429562:1-100';
```

**âš ï¸ å®‰å…¨è®¾ç½®æ­¥éª¤**
```sql
-- æ­¥éª¤1ï¼šåœæ­¢å¤åˆ¶
STOP SLAVE;

-- æ­¥éª¤2ï¼šå¤‡ä»½å½“å‰çŠ¶æ€
SELECT $$GLOBAL.gtid_executed, $$GLOBAL.gtid_purged;

-- æ­¥éª¤3ï¼šé‡ç½®GTIDçŠ¶æ€ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰
RESET MASTER;

-- æ­¥éª¤4ï¼šè®¾ç½®purgedï¼ˆåŒ…å«ç©ºæ´èŒƒå›´ï¼‰
SET $$GLOBAL.gtid_purged = 'uuid:1-50,uuid:52-100';
-- è¿™æ ·å°±è·³è¿‡äº†uuid:51è¿™ä¸ªç©ºæ´

-- æ­¥éª¤5ï¼šé‡å¯å¤åˆ¶
START SLAVE;

-- æ­¥éª¤6ï¼šéªŒè¯å¤åˆ¶çŠ¶æ€
SHOW SLAVE STATUS\G
```

### 4.2 æ•°æ®ä¸€è‡´æ€§éªŒè¯


**ğŸ” ä¿®å¤åçš„ä¸€è‡´æ€§æ£€æŸ¥**

```sql
-- ä½¿ç”¨checksuméªŒè¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§
-- åœ¨ä¸»åº“æ‰§è¡Œ
SELECT 
    SCHEMA_NAME,
    TABLE_NAME,
    CHECKSUM TABLE schema_name.table_name;

-- åœ¨ä»åº“æ‰§è¡Œç›¸åŒæŸ¥è¯¢ï¼Œå¯¹æ¯”ç»“æœ

-- æˆ–ä½¿ç”¨pt-table-checksumå·¥å…·
pt-table-checksum --host=master_host --databases=your_db
```

**ğŸ“Š ä¸€è‡´æ€§éªŒè¯è„šæœ¬**

```bash
#!/bin/bash
# GTIDç©ºæ´ä¿®å¤åä¸€è‡´æ€§éªŒè¯è„šæœ¬

MASTER_HOST="192.168.1.10"
SLAVE_HOST="192.168.1.11"
USERNAME="root"
PASSWORD="password"
DATABASE="test_db"

echo "ğŸ” å¼€å§‹æ•°æ®ä¸€è‡´æ€§éªŒè¯..."

# è·å–è¡¨åˆ—è¡¨
TABLES=$(mysql -h$MASTER_HOST -u$USERNAME -p$PASSWORD -D$DATABASE -e "SHOW TABLES" | tail -n +2)

for table in $TABLES; do
    echo "éªŒè¯è¡¨: $table"
    
    # ä¸»åº“checksum
    MASTER_CHECKSUM=$(mysql -h$MASTER_HOST -u$USERNAME -p$PASSWORD -D$DATABASE -e "CHECKSUM TABLE $table" | tail -n +2 | awk '{print $2}')
    
    # ä»åº“checksum  
    SLAVE_CHECKSUM=$(mysql -h$SLAVE_HOST -u$USERNAME -p$PASSWORD -D$DATABASE -e "CHECKSUM TABLE $table" | tail -n +2 | awk '{print $2}')
    
    if [ "$MASTER_CHECKSUM" = "$SLAVE_CHECKSUM" ]; then
        echo "âœ… $table: ä¸€è‡´"
    else
        echo "âŒ $table: ä¸ä¸€è‡´ (ä¸»åº“:$MASTER_CHECKSUM, ä»åº“:$SLAVE_CHECKSUM)"
    fi
done

echo "éªŒè¯å®Œæˆ"
```

### 4.3 ç©ºæ´è‡ªåŠ¨å¡«è¡¥æœºåˆ¶


**ğŸ¤– è‡ªåŠ¨åŒ–ç©ºæ´ä¿®å¤æµç¨‹**

```python
#!/usr/bin/env python3
# GTIDç©ºæ´è‡ªåŠ¨ä¿®å¤å·¥å…·

import mysql.connector
import logging
from typing import List, Dict

class GTIDHoleHealer:
    def __init__(self, config: Dict[str, str]):
        self.config = config
        self.logger = self._setup_logger()
    
    def _setup_logger(self):
        """è®¾ç½®æ—¥å¿—"""
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(levelname)s - %(message)s'
        )
        return logging.getLogger(__name__)
    
    def auto_heal_holes(self, holes: List[Tuple[str, str]]) -> bool:
        """è‡ªåŠ¨ä¿®å¤GTIDç©ºæ´"""
        try:
            conn = mysql.connector.connect(**self.config)
            cursor = conn.cursor()
            
            self.logger.info("ğŸš€ å¼€å§‹è‡ªåŠ¨ä¿®å¤GTIDç©ºæ´")
            
            # 1. åœæ­¢å¤åˆ¶
            self.logger.info("åœæ­¢å¤åˆ¶...")
            cursor.execute("STOP SLAVE")
            
            # 2. å¤‡ä»½å½“å‰çŠ¶æ€
            cursor.execute("SELECT $$GLOBAL.gtid_executed, $$GLOBAL.gtid_purged")
            backup_state = cursor.fetchone()
            self.logger.info(f"å¤‡ä»½çŠ¶æ€: {backup_state}")
            
            # 3. è®¡ç®—éœ€è¦purgeçš„GTIDèŒƒå›´
            purged_ranges = self._calculate_purged_ranges(holes)
            
            # 4. é‡ç½®å¹¶è®¾ç½®gtid_purged
            cursor.execute("RESET MASTER")
            cursor.execute(f"SET $$GLOBAL.gtid_purged = '{purged_ranges}'")
            
            # 5. é‡å¯å¤åˆ¶
            self.logger.info("é‡å¯å¤åˆ¶...")
            cursor.execute("START SLAVE")
            
            # 6. éªŒè¯ä¿®å¤ç»“æœ
            if self._verify_repair(cursor):
                self.logger.info("âœ… GTIDç©ºæ´ä¿®å¤æˆåŠŸ")
                return True
            else:
                self.logger.error("âŒ GTIDç©ºæ´ä¿®å¤å¤±è´¥")
                return False
                
        except Exception as e:
            self.logger.error(f"ä¿®å¤è¿‡ç¨‹å‡ºé”™: {e}")
            return False
        finally:
            if 'conn' in locals():
                conn.close()
    
    def _calculate_purged_ranges(self, holes: List[Tuple[str, str]]) -> str:
        """è®¡ç®—éœ€è¦purgeçš„GTIDèŒƒå›´"""
        # è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥æ›´å¤æ‚
        ranges = []
        for uuid, hole_range in holes:
            ranges.append(f"{uuid}:{hole_range}")
        return ','.join(ranges)
    
    def _verify_repair(self, cursor) -> bool:
        """éªŒè¯ä¿®å¤ç»“æœ"""
        cursor.execute("SHOW SLAVE STATUS")
        result = cursor.fetchone()
        
        # æ£€æŸ¥å¤åˆ¶æ˜¯å¦æ­£å¸¸è¿è¡Œ
        if result and result[10] == "Yes":  # Slave_IO_Running
            return True
        return False

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    config = {
        'host': 'localhost',
        'user': 'root',
        'password': 'password'
    }
    
    healer = GTIDHoleHealer(config)
    
    # å‡è®¾æ£€æµ‹åˆ°çš„ç©ºæ´
    holes = [
        ('3E11FA47-71CA-11E1-9E33-C80AA9429562', '11-14'),
        ('3E11FA47-71CA-11E1-9E33-C80AA9429562', '21-24')
    ]
    
    success = healer.auto_heal_holes(holes)
    print(f"ä¿®å¤ç»“æœ: {'æˆåŠŸ' if success else 'å¤±è´¥'}")
```

---

## 5. âš¡ GTIDäº‹åŠ¡è·³è¿‡æœºåˆ¶


### 5.1 SET SESSION GTID_NEXTæ‰‹åŠ¨è·³è¿‡


**ğŸ¯ æ‰‹åŠ¨è·³è¿‡çš„åŸºæœ¬åŸç†**

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> å°±åƒå‘Šè¯‰å¿«é€’å‘˜ï¼š"3å·åŒ…è£¹æˆ‘å·²ç»æ”¶åˆ°äº†ï¼ˆè™½ç„¶å®é™…æ²¡æ”¶åˆ°ï¼‰ï¼Œä½ å¯ä»¥ç»§ç»­é€4å·äº†"

```sql
-- æ‰‹åŠ¨è·³è¿‡å•ä¸ªGTIDçš„æ ‡å‡†æµç¨‹
SET $$SESSION.GTID_NEXT = '3E11FA47-71CA-11E1-9E33-C80AA9429562:100';
BEGIN;
COMMIT;  -- åˆ›å»ºä¸€ä¸ªç©ºäº‹åŠ¡å ç”¨è¿™ä¸ªGTID
SET $$SESSION.GTID_NEXT = 'AUTOMATIC';
```

**ğŸ“‹ å®Œæ•´çš„æ‰‹åŠ¨è·³è¿‡æµç¨‹**
```sql
-- æ­¥éª¤1ï¼šæ£€æŸ¥å½“å‰å¤åˆ¶çŠ¶æ€
SHOW SLAVE STATUS\G

-- æ­¥éª¤2ï¼šç¡®è®¤è¦è·³è¿‡çš„GTID
-- ä»Last_SQL_Errorä¸­è·å–å¡ä½çš„GTID

-- æ­¥éª¤3ï¼šåœæ­¢SQLçº¿ç¨‹
STOP SLAVE SQL_THREAD;

-- æ­¥éª¤4ï¼šæ‰‹åŠ¨è·³è¿‡
SET $$SESSION.GTID_NEXT = 'server_uuid:transaction_id';
BEGIN;
COMMIT;
SET $$SESSION.GTID_NEXT = 'AUTOMATIC';

-- æ­¥éª¤5ï¼šé‡å¯SQLçº¿ç¨‹
START SLAVE SQL_THREAD;

-- æ­¥éª¤6ï¼šéªŒè¯è·³è¿‡ç»“æœ
SHOW SLAVE STATUS\G
```

### 5.2 ç©ºäº‹åŠ¡æ³¨å…¥æ–¹æ³•


**ğŸ’‰ ç©ºäº‹åŠ¡æ³¨å…¥çš„ä½œç”¨æœºåˆ¶**

```sql
-- ç©ºäº‹åŠ¡æ³¨å…¥ç¤ºä¾‹
-- ç›®çš„ï¼šç”¨ç©ºäº‹åŠ¡"å¡«è¡¥"GTIDç©ºæ´

SET $$SESSION.GTID_NEXT = '3E11FA47-71CA-11E1-9E33-C80AA9429562:51';
CREATE TABLE IF NOT EXISTS gtid_hole_filler (id INT);
DROP TABLE IF EXISTS gtid_hole_filler;
SET $$SESSION.GTID_NEXT = 'AUTOMATIC';
```

**ğŸ” ä¸åŒç±»å‹çš„ç©ºäº‹åŠ¡**
```sql
-- æ–¹æ³•1ï¼šç®€å•BEGIN/COMMIT
SET $$SESSION.GTID_NEXT = 'uuid:100';
BEGIN;
COMMIT;

-- æ–¹æ³•2ï¼šä¸´æ—¶è¡¨æ“ä½œ
SET $$SESSION.GTID_NEXT = 'uuid:100';
CREATE TEMPORARY TABLE temp_fill (id INT);
DROP TEMPORARY TABLE temp_fill;

-- æ–¹æ³•3ï¼šç©ºçš„DMLæ“ä½œ
SET $$SESSION.GTID_NEXT = 'uuid:100';
UPDATE mysql.gtid_executed SET source_uuid=source_uuid WHERE 1=0;

SET $$SESSION.GTID_NEXT = 'AUTOMATIC';
```

### 5.3 æ‰¹é‡è·³è¿‡ç­–ç•¥


**ğŸš€ æ‰¹é‡å¤„ç†GTIDç©ºæ´**

```python
#!/usr/bin/env python3
# æ‰¹é‡GTIDè·³è¿‡è„šæœ¬

import mysql.connector
from typing import List

def batch_skip_gtids(host: str, user: str, password: str, gtid_list: List[str]):
    """æ‰¹é‡è·³è¿‡GTIDåˆ—è¡¨"""
    
    conn = mysql.connector.connect(
        host=host, user=user, password=password, autocommit=True
    )
    cursor = conn.cursor()
    
    try:
        print(f"ğŸš€ å¼€å§‹æ‰¹é‡è·³è¿‡ {len(gtid_list)} ä¸ªGTID")
        
        # åœæ­¢SQLçº¿ç¨‹
        cursor.execute("STOP SLAVE SQL_THREAD")
        print("å·²åœæ­¢SQLçº¿ç¨‹")
        
        # æ‰¹é‡è·³è¿‡
        for i, gtid in enumerate(gtid_list, 1):
            print(f"è·³è¿‡ {i}/{len(gtid_list)}: {gtid}")
            
            # è®¾ç½®GTID_NEXT
            cursor.execute(f"SET $$SESSION.GTID_NEXT = '{gtid}'")
            
            # æ‰§è¡Œç©ºäº‹åŠ¡
            cursor.execute("BEGIN")
            cursor.execute("COMMIT")
            
            # é‡ç½®GTID_NEXT
            cursor.execute("SET $$SESSION.GTID_NEXT = 'AUTOMATIC'")
        
        # é‡å¯SQLçº¿ç¨‹
        cursor.execute("START SLAVE SQL_THREAD")
        print("âœ… æ‰¹é‡è·³è¿‡å®Œæˆï¼Œå·²é‡å¯SQLçº¿ç¨‹")
        
        # éªŒè¯ç»“æœ
        cursor.execute("SHOW SLAVE STATUS")
        result = cursor.fetchone()
        print(f"å¤åˆ¶çŠ¶æ€: {result[10]} / {result[11]}")  # IO/SQL Running
        
    except Exception as e:
        print(f"âŒ æ‰¹é‡è·³è¿‡å¤±è´¥: {e}")
        # å°è¯•æ¢å¤
        try:
            cursor.execute("START SLAVE SQL_THREAD")
        except:
            pass
    finally:
        conn.close()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # éœ€è¦è·³è¿‡çš„GTIDåˆ—è¡¨
    skip_list = [
        '3E11FA47-71CA-11E1-9E33-C80AA9429562:51',
        '3E11FA47-71CA-11E1-9E33-C80AA9429562:52', 
        '3E11FA47-71CA-11E1-9E33-C80AA9429562:53'
    ]
    
    batch_skip_gtids(
        host='slave_host',
        user='root',
        password='password',
        gtid_list=skip_list
    )
```

### 5.4 è·³è¿‡æ“ä½œçš„å®‰å…¨è§„èŒƒ


**âš ï¸ è·³è¿‡æ“ä½œçš„é£é™©æ§åˆ¶**

```
è·³è¿‡æ“ä½œé£é™©è¯„ä¼°ï¼š

ğŸ”¸ æ•°æ®ä¸¢å¤±é£é™©ï¼š
- è·³è¿‡çš„GTIDå¯¹åº”çš„æ•°æ®å˜æ›´ä¼šæ°¸ä¹…ä¸¢å¤±
- å¯èƒ½å¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´

ğŸ”¸ ä¸šåŠ¡å½±å“é£é™©ï¼š
- å…³é”®ä¸šåŠ¡æ•°æ®å¯èƒ½ç¼ºå¤±
- å¯èƒ½å½±å“ä¸šåŠ¡é€»è¾‘çš„å®Œæ•´æ€§

ğŸ”¸ åç»­é—®é¢˜é£é™©ï¼š
- å¯èƒ½å¼•å‘çº§è”çš„æ•°æ®é—®é¢˜
- å¢åŠ æ•…éšœæ’æŸ¥çš„å¤æ‚æ€§
```

**ğŸ“‹ å®‰å…¨è·³è¿‡æ£€æŸ¥æ¸…å•**

- [ ] **ğŸ“Š æ•°æ®é‡è¦æ€§è¯„ä¼°**ï¼šç¡®è®¤è·³è¿‡çš„äº‹åŠ¡ä¸æ¶‰åŠæ ¸å¿ƒä¸šåŠ¡æ•°æ®
- [ ] **ğŸ” å½±å“èŒƒå›´åˆ†æ**ï¼šè¯„ä¼°è·³è¿‡å¯¹ä¸‹æ¸¸ä¸šåŠ¡çš„å½±å“
- [ ] **ğŸ’¾ å¤‡ä»½ç¡®è®¤**ï¼šç¡®ä¿æœ‰å¯æ¢å¤çš„å¤‡ä»½
- [ ] **ğŸ§ª æµ‹è¯•ç¯å¢ƒéªŒè¯**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå…ˆè¡ŒéªŒè¯
- [ ] **ğŸ“ æ“ä½œè®°å½•**ï¼šè¯¦ç»†è®°å½•è·³è¿‡çš„GTIDå’ŒåŸå› 
- [ ] **ğŸ”” ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®è·³è¿‡åçš„ç›‘æ§å’Œå‘Šè­¦

**ğŸ›¡ï¸ å®‰å…¨è·³è¿‡æµç¨‹æ¨¡æ¿**
```sql
-- å®‰å…¨è·³è¿‡æµç¨‹æ¨¡æ¿

-- 1. äº‹å‰æ£€æŸ¥
SELECT 'Pre-check: Backup status, Business impact assessment';

-- 2. å¤‡ä»½å…³é”®ä¿¡æ¯
CREATE TABLE gtid_skip_log (
    skip_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    gtid_skipped VARCHAR(100),
    reason TEXT,
    operator VARCHAR(50)
);

-- 3. è®°å½•è·³è¿‡æ“ä½œ
INSERT INTO gtid_skip_log (gtid_skipped, reason, operator) 
VALUES ('uuid:100', 'Transaction failed due to constraint violation', 'admin');

-- 4. æ‰§è¡Œè·³è¿‡
SET $$SESSION.GTID_NEXT = 'uuid:100';
BEGIN;
COMMIT;
SET $$SESSION.GTID_NEXT = 'AUTOMATIC';

-- 5. äº‹åéªŒè¯
SHOW SLAVE STATUS\G
```

---

## 6. ğŸ“Š ç©ºæ´é¢„é˜²ä¸ç›‘æ§


### 6.1 ç©ºæ´é¢„é˜²æªæ–½


**ğŸ›¡ï¸ ä»æºå¤´é¢„é˜²GTIDç©ºæ´**

**ğŸ“‹ åº”ç”¨å±‚é¢„é˜²ç­–ç•¥**
```sql
-- 1. äº‹åŠ¡è®¾è®¡ä¼˜åŒ–
-- é¿å…é•¿äº‹åŠ¡ï¼Œå‡å°‘äº‹åŠ¡å¤±è´¥æ¦‚ç‡
BEGIN;
-- ç®€å•ã€å¿«é€Ÿçš„æ“ä½œ
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
INSERT INTO transactions (account_id, amount, type) VALUES (1, -100, 'debit');
COMMIT;

-- 2. çº¦æŸæ£€æŸ¥å‰ç½®
-- åœ¨äº‹åŠ¡å¼€å§‹å‰æ£€æŸ¥çº¦æŸæ¡ä»¶
SELECT COUNT(*) FROM accounts WHERE id = 1 AND balance >= 100;
-- åªæœ‰æ£€æŸ¥é€šè¿‡æ‰å¼€å§‹äº‹åŠ¡

-- 3. é”™è¯¯å¤„ç†æœºåˆ¶
DELIMITER //
CREATE PROCEDURE SafeTransfer(IN from_account INT, IN to_account INT, IN amount DECIMAL(10,2))
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        GET DIAGNOSTICS CONDITION 1 @error_message = MESSAGE_TEXT;
        INSERT INTO error_log (error_time, error_message, operation) 
        VALUES (NOW(), @error_message, 'transfer');
    END;
    
    START TRANSACTION;
    
    -- é¢„æ£€æŸ¥
    IF (SELECT balance FROM accounts WHERE id = from_account) < amount THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Insufficient balance';
    END IF;
    
    -- æ‰§è¡Œè½¬è´¦
    UPDATE accounts SET balance = balance - amount WHERE id = from_account;
    UPDATE accounts SET balance = balance + amount WHERE id = to_account;
    
    COMMIT;
END //
DELIMITER ;
```

**âš™ï¸ ç³»ç»Ÿé…ç½®ä¼˜åŒ–**
```sql
-- MySQLé…ç½®ä¼˜åŒ–é˜²æ­¢ç©ºæ´

-- 1. å¢å¼ºäº‹åŠ¡æˆåŠŸç‡
[mysqld]
# å¢åŠ é”ç­‰å¾…è¶…æ—¶æ—¶é—´
lock_wait_timeout = 60

# å‡å°‘æ­»é”æ£€æµ‹é¢‘ç‡
innodb_deadlock_detect = OFF

# ä¼˜åŒ–ç¼“å†²æ± ï¼Œå‡å°‘IOé”™è¯¯
innodb_buffer_pool_size = 2G

# 2. å¤åˆ¶å‚æ•°ä¼˜åŒ–
# å¯ç”¨å¹¶è¡Œå¤åˆ¶å‡å°‘å»¶è¿Ÿ
slave_parallel_workers = 4
slave_parallel_type = LOGICAL_CLOCK

# 3. GTIDç›¸å…³ä¼˜åŒ–
# ç¡®ä¿GTIDä¸€è‡´æ€§
enforce_gtid_consistency = ON
gtid_mode = ON
```

### 6.2 å®æ—¶ç›‘æ§å‘Šè­¦ç³»ç»Ÿ


**ğŸ“ˆ GTIDç©ºæ´å®æ—¶ç›‘æ§**

```python
#!/usr/bin/env python3
# GTIDç©ºæ´å®æ—¶ç›‘æ§ç³»ç»Ÿ

import mysql.connector
import time
import smtplib
from email.mime.text import MimeText
from threading import Thread
import logging

class GTIDMonitor:
    def __init__(self, db_config: dict, alert_config: dict):
        self.db_config = db_config
        self.alert_config = alert_config
        self.last_gtid_state = ""
        self.hole_count = 0
        self.logger = self._setup_logger()
        
    def _setup_logger(self):
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(levelname)s - %(message)s',
            handlers=[
                logging.FileHandler('/var/log/gtid_monitor.log'),
                logging.StreamHandler()
            ]
        )
        return logging.getLogger(__name__)
    
    def start_monitoring(self, interval: int = 30):
        """å¯åŠ¨ç›‘æ§ï¼Œæ¯intervalç§’æ£€æŸ¥ä¸€æ¬¡"""
        self.logger.info("ğŸš€ å¯åŠ¨GTIDç©ºæ´ç›‘æ§")
        
        while True:
            try:
                self._check_gtid_holes()
                time.sleep(interval)
            except KeyboardInterrupt:
                self.logger.info("ç›‘æ§åœæ­¢")
                break
            except Exception as e:
                self.logger.error(f"ç›‘æ§è¿‡ç¨‹å‡ºé”™: {e}")
                time.sleep(interval)
    
    def _check_gtid_holes(self):
        """æ£€æŸ¥GTIDç©ºæ´"""
        try:
            conn = mysql.connector.connect(**self.db_config)
            cursor = conn.cursor()
            
            # è·å–å½“å‰GTIDçŠ¶æ€
            cursor.execute("SELECT $$GLOBAL.gtid_executed")
            current_gtid = cursor.fetchone()[0]
            
            # æ£€æŸ¥å¤åˆ¶çŠ¶æ€
            cursor.execute("SHOW SLAVE STATUS")
            slave_status = cursor.fetchone()
            
            # åˆ†æç©ºæ´
            holes = self._analyze_holes(current_gtid)
            new_hole_count = len(holes)
            
            # æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç©ºæ´
            if new_hole_count > self.hole_count:
                self._send_alert(f"ğŸš¨ å‘ç°æ–°çš„GTIDç©ºæ´: {holes}")
                self.hole_count = new_hole_count
            
            # æ£€æŸ¥å¤åˆ¶çŠ¶æ€
            if slave_status:
                io_running = slave_status[10]  # Slave_IO_Running
                sql_running = slave_status[11]  # Slave_SQL_Running
                
                if io_running != 'Yes' or sql_running != 'Yes':
                    self._send_alert(f"ğŸš¨ å¤åˆ¶å¼‚å¸¸: IO={io_running}, SQL={sql_running}")
            
            # è®°å½•çŠ¶æ€
            self.logger.info(f"âœ… ç›‘æ§æ­£å¸¸ - å½“å‰ç©ºæ´æ•°: {new_hole_count}")
            
        except Exception as e:
            self.logger.error(f"æ£€æŸ¥è¿‡ç¨‹å‡ºé”™: {e}")
        finally:
            if 'conn' in locals():
                conn.close()
    
    def _analyze_holes(self, gtid_executed: str) -> list:
        """åˆ†æGTIDç©ºæ´"""
        holes = []
        
        if not gtid_executed:
            return holes
            
        # ç®€åŒ–çš„ç©ºæ´æ£€æµ‹é€»è¾‘
        for uuid_range in gtid_executed.split(','):
            if ':' not in uuid_range:
                continue
                
            parts = uuid_range.split(':')
            if len(parts) > 2:  # æœ‰ç©ºæ´ä¼šå¯¼è‡´å¤šä¸ªèŒƒå›´
                holes.append(uuid_range)
        
        return holes
    
    def _send_alert(self, message: str):
        """å‘é€å‘Šè­¦é‚®ä»¶"""
        try:
            msg = MimeText(message, 'plain', 'utf-8')
            msg['Subject'] = 'GTIDç©ºæ´å‘Šè­¦'
            msg['From'] = self.alert_config['from_email']
            msg['To'] = self.alert_config['to_email']
            
            server = smtplib.SMTP(self.alert_config['smtp_server'])
            server.starttls()
            server.login(
                self.alert_config['smtp_user'],
                self.alert_config['smtp_password']
            )
            server.send_message(msg)
            server.quit()
            
            self.logger.info(f"ğŸ“§ å‘Šè­¦é‚®ä»¶å·²å‘é€: {message}")
            
        except Exception as e:
            self.logger.error(f"å‘é€å‘Šè­¦é‚®ä»¶å¤±è´¥: {e}")

# ç›‘æ§é…ç½®
db_config = {
    'host': 'localhost',
    'user': 'monitor_user',
    'password': 'monitor_password',
    'database': 'mysql'
}

alert_config = {
    'smtp_server': 'smtp.company.com',
    'smtp_user': 'monitor@company.com', 
    'smtp_password': 'password',
    'from_email': 'monitor@company.com',
    'to_email': 'dba@company.com'
}

# å¯åŠ¨ç›‘æ§
if __name__ == "__main__":
    monitor = GTIDMonitor(db_config, alert_config)
    monitor.start_monitoring(interval=60)  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
```

### 6.3 æ€§èƒ½å½±å“ç›‘æ§


**ğŸ“Š ç©ºæ´å¯¹å¤åˆ¶æ€§èƒ½çš„ç›‘æ§æŒ‡æ ‡**

```sql
-- åˆ›å»ºæ€§èƒ½ç›‘æ§è§†å›¾
CREATE VIEW gtid_replication_performance AS
SELECT 
    'Replication Lag' AS metric,
    CASE 
        WHEN Seconds_Behind_Master IS NULL THEN 'Unknown'
        WHEN Seconds_Behind_Master = 0 THEN 'No Lag'
        WHEN Seconds_Behind_Master < 5 THEN 'Low Lag'
        WHEN Seconds_Behind_Master < 30 THEN 'Medium Lag' 
        ELSE 'High Lag'
    END AS status,
    Seconds_Behind_Master AS value
FROM information_schema.replica_host_status
UNION ALL
SELECT 
    'IO Thread Status' AS metric,
    Slave_IO_Running AS status,
    0 AS value
FROM information_schema.replica_host_status
UNION ALL
SELECT 
    'SQL Thread Status' AS metric,
    Slave_SQL_Running AS status,
    0 AS value  
FROM information_schema.replica_host_status;

-- ç›‘æ§æŸ¥è¯¢
SELECT * FROM gtid_replication_performance;
```

**âš¡ æ€§èƒ½åŸºå‡†ç›‘æ§è„šæœ¬**

```bash
#!/bin/bash
# GTIDç©ºæ´æ€§èƒ½å½±å“ç›‘æ§è„šæœ¬

MYSQL_HOST="localhost"
MYSQL_USER="root"
MYSQL_PASS="password"

# è·å–å¤åˆ¶å»¶è¿Ÿ
get_replication_lag() {
    mysql -h$MYSQL_HOST -u$MYSQL_USER -p$MYSQL_PASS -e "
        SELECT 
            IFNULL(Seconds_Behind_Master, -1) as lag_seconds,
            Slave_IO_Running,
            Slave_SQL_Running
        FROM information_schema.replica_host_status
    " 2>/dev/null
}

# è·å–GTIDçŠ¶æ€
get_gtid_status() {
    mysql -h$MYSQL_HOST -u$MYSQL_USER -p$MYSQL_PASS -e "
        SELECT 
            $$GLOBAL.gtid_executed as executed,
            $$GLOBAL.gtid_purged as purged
    " 2>/dev/null
}

# ä¸»ç›‘æ§å¾ªç¯
while true; do
    echo "$(date): æ£€æŸ¥å¤åˆ¶æ€§èƒ½..."
    
    # æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
    REPL_STATUS=$(get_replication_lag)
    LAG=$(echo "$REPL_STATUS" | tail -n +2 | awk '{print $1}')
    
    if [ "$LAG" -gt 30 ]; then
        echo "ğŸš¨ è­¦å‘Š: å¤åˆ¶å»¶è¿Ÿ ${LAG} ç§’ï¼Œå¯èƒ½å­˜åœ¨GTIDç©ºæ´å½±å“"
        # è¿™é‡Œå¯ä»¥è°ƒç”¨å‘Šè­¦è„šæœ¬
    elif [ "$LAG" -gt 5 ]; then
        echo "âš ï¸  æ³¨æ„: å¤åˆ¶å»¶è¿Ÿ ${LAG} ç§’"
    else
        echo "âœ… å¤åˆ¶æ­£å¸¸ï¼Œå»¶è¿Ÿ ${LAG} ç§’"
    fi
    
    sleep 60
done
```

---

## 7. ğŸ¯ ç©ºæ´å¤„ç†çš„ä¸šåŠ¡å½±å“æ§åˆ¶


### 7.1 ä¸šåŠ¡å½±å“æœ€å°åŒ–ç­–ç•¥


**ğŸ•’ é€‰æ‹©æœ€ä½³ç»´æŠ¤æ—¶é—´çª—å£**

```
ä¸šåŠ¡å½±å“æœ€å°åŒ–åŸåˆ™ï¼š

ğŸ”¸ æ—¶é—´é€‰æ‹©ï¼š
- ä¸šåŠ¡ä½å³°æœŸï¼ˆå¦‚å‡Œæ™¨2-6ç‚¹ï¼‰
- éå…³é”®ä¸šåŠ¡æ—¶æ®µ
- æå‰é€šçŸ¥ç›¸å…³ä¸šåŠ¡æ–¹

ğŸ”¸ æ“ä½œç­–ç•¥ï¼š
- åˆ†æ‰¹å¤„ç†ï¼Œé¿å…é•¿æ—¶é—´ä¸­æ–­
- å…ˆå¤„ç†æµ‹è¯•ç¯å¢ƒï¼Œå†å¤„ç†ç”Ÿäº§ç¯å¢ƒ
- å‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ

ğŸ”¸ å½±å“è¯„ä¼°ï¼š
- è¯„ä¼°ç©ºæ´æ¶‰åŠçš„ä¸šåŠ¡æ•°æ®
- ç¡®è®¤æ˜¯å¦å½±å“æ ¸å¿ƒä¸šåŠ¡æµç¨‹
- åˆ¶å®šä¸šåŠ¡åº”æ€¥é¢„æ¡ˆ
```

**ğŸ“Š å½±å“è¯„ä¼°çŸ©é˜µ**

| ç©ºæ´ç±»å‹ | **ä¸šåŠ¡å½±å“** | **æ•°æ®é£é™©** | **å¤„ç†ç­–ç•¥** | **æ—¶é—´çª—å£** |
|---------|-------------|-------------|-------------|-------------|
| `DDLæ“ä½œç©ºæ´` | `ğŸŸ¢ ä½` | `ğŸŸ¢ ä½` | `ç«‹å³ä¿®å¤` | `ä»»æ„æ—¶é—´` |
| `é…ç½®æ›´æ–°ç©ºæ´` | `ğŸŸ¡ ä¸­` | `ğŸŸ¡ ä¸­` | `è®¡åˆ’ä¿®å¤` | `ç»´æŠ¤çª—å£` |
| `æ•°æ®å˜æ›´ç©ºæ´` | `ğŸ”´ é«˜` | `ğŸ”´ é«˜` | `è°¨æ…è¯„ä¼°` | `ä¸šåŠ¡ä½å³°` |
| `æ ¸å¿ƒäº¤æ˜“ç©ºæ´` | `ğŸš¨ ä¸¥é‡` | `ğŸš¨ ä¸¥é‡` | `ç´§æ€¥å¤„ç†` | `ç«‹å³å¤„ç†` |

### 7.2 ç©ºæ´å¤„ç†ä¸ä¸»ä»åˆ‡æ¢åè°ƒ


**ğŸ”„ åˆ‡æ¢è¿‡ç¨‹ä¸­çš„ç©ºæ´å¤„ç†**

```sql
-- ä¸»ä»åˆ‡æ¢å‰çš„GTIDç©ºæ´æ£€æŸ¥å’Œä¿®å¤æµç¨‹

-- 1. åœ¨åˆ‡æ¢å‰æ£€æŸ¥æ‰€æœ‰ä»åº“çš„GTIDçŠ¶æ€
SELECT 
    $$GLOBAL.gtid_executed as current_executed,
    $$GLOBAL.gtid_purged as current_purged,
    $$GLOBAL.server_uuid as server_id
FROM mysql.gtid_executed;

-- 2. ç¡®ä¿æ‰€æœ‰ä»åº“GTIDçŠ¶æ€ä¸€è‡´
-- åœ¨æ¯ä¸ªä»åº“æ‰§è¡Œæ­¤æ£€æŸ¥
SHOW SLAVE STATUS\G

-- 3. ä¿®å¤ä»»ä½•å‘ç°çš„ç©ºæ´
-- ä½¿ç”¨å‰é¢ä»‹ç»çš„æ–¹æ³•è¿›è¡Œä¿®å¤

-- 4. éªŒè¯ä¿®å¤åçš„ä¸€è‡´æ€§
-- ç¡®ä¿æ‰€æœ‰ä»åº“çš„gtid_executedä¸€è‡´
```

**ğŸ¯ åè°ƒæœºåˆ¶è®¾è®¡**

```python
#!/usr/bin/env python3
# ä¸»ä»åˆ‡æ¢GTIDåè°ƒå·¥å…·

import mysql.connector
from typing import List, Dict, Tuple
import time

class GTIDSwitchCoordinator:
    def __init__(self, master_config: dict, slave_configs: List[dict]):
        self.master_config = master_config
        self.slave_configs = slave_configs
        
    def prepare_for_switch(self) -> bool:
        """ä¸ºä¸»ä»åˆ‡æ¢å‡†å¤‡GTIDçŠ¶æ€"""
        print("ğŸš€ å¼€å§‹ä¸»ä»åˆ‡æ¢GTIDåè°ƒ...")
        
        # 1. æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹çš„GTIDçŠ¶æ€
        master_gtid = self._get_gtid_status(self.master_config)
        slave_gtids = []
        
        for slave_config in self.slave_configs:
            slave_gtid = self._get_gtid_status(slave_config)
            slave_gtids.append((slave_config['host'], slave_gtid))
        
        # 2. åˆ†æGTIDå·®å¼‚
        differences = self._analyze_gtid_differences(master_gtid, slave_gtids)
        
        if differences:
            print(f"âš ï¸  å‘ç°GTIDå·®å¼‚: {len(differences)}ä¸ª")
            
            # 3. ä¿®å¤GTIDå·®å¼‚
            for diff in differences:
                success = self._fix_gtid_difference(diff)
                if not success:
                    print(f"âŒ ä¿®å¤å¤±è´¥: {diff}")
                    return False
            
            print("âœ… æ‰€æœ‰GTIDå·®å¼‚å·²ä¿®å¤")
        else:
            print("âœ… æ‰€æœ‰èŠ‚ç‚¹GTIDçŠ¶æ€ä¸€è‡´")
        
        # 4. æœ€ç»ˆéªŒè¯
        return self._final_verification()
    
    def _get_gtid_status(self, config: dict) -> str:
        """è·å–èŠ‚ç‚¹çš„GTIDçŠ¶æ€"""
        try:
            conn = mysql.connector.connect(**config)
            cursor = conn.cursor()
            cursor.execute("SELECT $$GLOBAL.gtid_executed")
            result = cursor.fetchone()[0]
            return result or ""
        except Exception as e:
            print(f"è·å–GTIDçŠ¶æ€å¤±è´¥ {config['host']}: {e}")
            return ""
        finally:
            if 'conn' in locals():
                conn.close()
    
    def _analyze_gtid_differences(self, master_gtid: str, slave_gtids: List[Tuple[str, str]]) -> List[dict]:
        """åˆ†æGTIDå·®å¼‚"""
        differences = []
        
        for host, slave_gtid in slave_gtids:
            if master_gtid != slave_gtid:
                differences.append({
                    'host': host,
                    'master_gtid': master_gtid,
                    'slave_gtid': slave_gtid,
                    'type': 'gtid_mismatch'
                })
        
        return differences
    
    def _fix_gtid_difference(self, diff: dict) -> bool:
        """ä¿®å¤GTIDå·®å¼‚"""
        # è¿™é‡Œå®ç°å…·ä½“çš„ä¿®å¤é€»è¾‘
        # æ ¹æ®å·®å¼‚ç±»å‹é€‰æ‹©ä¸åŒçš„ä¿®å¤ç­–ç•¥
        print(f"ä¿®å¤ {diff['host']} çš„GTIDå·®å¼‚...")
        
        # å®é™…å®ç°ä¼šæ›´å¤æ‚ï¼Œéœ€è¦åˆ†æå…·ä½“çš„GTIDå·®å¼‚
        # å¹¶é€‰æ‹©åˆé€‚çš„ä¿®å¤æ–¹æ³•ï¼ˆpurgeè®¾ç½®ã€äº‹åŠ¡è·³è¿‡ç­‰ï¼‰
        
        return True
    
    def _final_verification(self) -> bool:
        """æœ€ç»ˆéªŒè¯æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´"""
        print("è¿›è¡Œæœ€ç»ˆä¸€è‡´æ€§éªŒè¯...")
        
        # å†æ¬¡æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹çš„GTIDçŠ¶æ€
        master_gtid = self._get_gtid_status(self.master_config)
        
        for slave_config in self.slave_configs:
            slave_gtid = self._get_gtid_status(slave_config)
            if master_gtid != slave_gtid:
                print(f"âŒ {slave_config['host']} GTIDçŠ¶æ€ä»ä¸ä¸€è‡´")
                return False
        
        print("âœ… æ‰€æœ‰èŠ‚ç‚¹GTIDçŠ¶æ€ä¸€è‡´ï¼Œå¯ä»¥è¿›è¡Œåˆ‡æ¢")
        return True

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    master_config = {
        'host': '192.168.1.10',
        'user': 'root',
        'password': 'password'
    }
    
    slave_configs = [
        {'host': '192.168.1.11', 'user': 'root', 'password': 'password'},
        {'host': '192.168.1.12', 'user': 'root', 'password': 'password'}
    ]
    
    coordinator = GTIDSwitchCoordinator(master_config, slave_configs)
    
    if coordinator.prepare_for_switch():
        print("ğŸ‰ GTIDåè°ƒå®Œæˆï¼Œå¯ä»¥è¿›è¡Œä¸»ä»åˆ‡æ¢")
    else:
        print("âŒ GTIDåè°ƒå¤±è´¥ï¼Œä¸å»ºè®®è¿›è¡Œåˆ‡æ¢")
```

### 7.3 ç©ºæ´ä¿®å¤çš„å›æ»šç­–ç•¥


**ğŸ”„ ä¿®å¤æ“ä½œçš„å®‰å…¨å›æ»š**

```sql
-- ä¿®å¤æ“ä½œå›æ»šé¢„æ¡ˆ

-- 1. ä¿®å¤å‰çŠ¶æ€å¤‡ä»½
CREATE TABLE gtid_repair_backup (
    repair_id INT AUTO_INCREMENT PRIMARY KEY,
    repair_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    original_gtid_executed TEXT,
    original_gtid_purged TEXT,
    operation_type VARCHAR(50),
    operation_details TEXT
);

-- 2. è®°å½•ä¿®å¤æ“ä½œ
INSERT INTO gtid_repair_backup 
(original_gtid_executed, original_gtid_purged, operation_type, operation_details)
SELECT 
    $$GLOBAL.gtid_executed,
    $$GLOBAL.gtid_purged,
    'hole_repair',
    'Attempting to fix GTID holes in range uuid:100-105';

-- 3. å›æ»šæ“ä½œæ¨¡æ¿
DELIMITER //
CREATE PROCEDURE RollbackGTIDRepair(IN repair_id INT)
BEGIN
    DECLARE orig_executed TEXT;
    DECLARE orig_purged TEXT;
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;
    
    -- è·å–åŸå§‹çŠ¶æ€
    SELECT original_gtid_executed, original_gtid_purged
    INTO orig_executed, orig_purged
    FROM gtid_repair_backup 
    WHERE repair_id = repair_id;
    
    -- åœæ­¢å¤åˆ¶
    STOP SLAVE;
    
    -- æ¢å¤åŸå§‹çŠ¶æ€
    RESET MASTER;
    SET $$GLOBAL.gtid_purged = orig_purged;
    
    -- é‡å¯å¤åˆ¶
    START SLAVE;
    
    -- è®°å½•å›æ»šæ“ä½œ
    INSERT INTO gtid_repair_backup 
    (operation_type, operation_details) 
    VALUES ('rollback', CONCAT('Rolled back repair_id: ', repair_id));
    
END //
DELIMITER ;
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ GTIDç©ºæ´æœ¬è´¨ï¼šGTIDåºåˆ—ä¸­ç¼ºå¤±çš„äº‹åŠ¡ç¼–å·ï¼Œç ´åå¤åˆ¶è¿ç»­æ€§
ğŸ”¸ ç©ºæ´æˆå› ï¼šäº‹åŠ¡å¤±è´¥ã€ä¸»ä»åˆ‡æ¢ã€å¤åˆ¶å¼‚å¸¸ã€äººä¸ºæ“ä½œé”™è¯¯
ğŸ”¸ æ£€æµ‹æ–¹æ³•ï¼šç³»ç»Ÿå˜é‡æŸ¥çœ‹ã€è‡ªåŠ¨åŒ–è„šæœ¬ã€å®æ—¶ç›‘æ§å‘Šè­¦
ğŸ”¸ ä¿®å¤ç­–ç•¥ï¼šgtid_purgedè®¾ç½®ã€ç©ºäº‹åŠ¡æ³¨å…¥ã€æ‰¹é‡è·³è¿‡å¤„ç†
ğŸ”¸ é¢„é˜²æªæ–½ï¼šåº”ç”¨ä¼˜åŒ–ã€ç³»ç»Ÿé…ç½®ã€ç›‘æ§å‘Šè­¦ã€åè°ƒæœºåˆ¶
```

### 8.2 å…³é”®æ“ä½œæµç¨‹


**ğŸ”¹ GTIDç©ºæ´æ£€æµ‹æµç¨‹**
```
1. å®šæœŸæ£€æŸ¥ $$gtid_executed çŠ¶æ€
2. åˆ†æGTIDåºåˆ—çš„è¿ç»­æ€§
3. ç›‘æ§å¤åˆ¶å»¶è¿Ÿå’Œé”™è¯¯ä¿¡æ¯
4. è‡ªåŠ¨åŒ–å‘Šè­¦é€šçŸ¥ç›¸å…³äººå‘˜
```

**ğŸ”¹ å®‰å…¨ä¿®å¤æµç¨‹**
```
1. å¤‡ä»½å½“å‰GTIDçŠ¶æ€
2. è¯„ä¼°ç©ºæ´å¯¹ä¸šåŠ¡çš„å½±å“
3. é€‰æ‹©åˆé€‚çš„ä¿®å¤ç­–ç•¥
4. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ“ä½œ
5. åœ¨ç»´æŠ¤çª—å£æ‰§è¡Œä¿®å¤
6. éªŒè¯ä¿®å¤ç»“æœå’Œæ•°æ®ä¸€è‡´æ€§
```

**ğŸ”¹ é¢„é˜²æ§åˆ¶æµç¨‹**
```
1. ä¼˜åŒ–åº”ç”¨äº‹åŠ¡è®¾è®¡
2. é…ç½®åˆç†çš„ç³»ç»Ÿå‚æ•°
3. å»ºç«‹å®æ—¶ç›‘æ§å‘Šè­¦
4. åˆ¶å®šæ ‡å‡†æ“ä½œè§„èŒƒ
5. å®šæœŸè¿›è¡Œæ¼”ç»ƒå’Œæµ‹è¯•
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… æœ€ä½³å®è·µåŸåˆ™**
- **é¢„é˜²ä¼˜äºæ²»ç–—**ï¼šé€šè¿‡ä¼˜åŒ–è®¾è®¡é¿å…ç©ºæ´äº§ç”Ÿ
- **ç›‘æ§åŠæ—¶å‘ç°**ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å‘Šè­¦æœºåˆ¶
- **è°¨æ…å®‰å…¨ä¿®å¤**ï¼šå……åˆ†è¯„ä¼°åå†æ‰§è¡Œä¿®å¤æ“ä½œ
- **æ–‡æ¡£è®°å½•å®Œæ•´**ï¼šè¯¦ç»†è®°å½•æ‰€æœ‰æ“ä½œå’Œå˜æ›´

**âŒ å¸¸è§é”™è¯¯é¿å…**
- **ç›²ç›®è·³è¿‡äº‹åŠ¡**ï¼šæœªè¯„ä¼°å½±å“å°±è·³è¿‡GTID
- **ç¼ºä¹å¤‡ä»½ä¿æŠ¤**ï¼šä¿®å¤å‰æœªåšå……åˆ†å¤‡ä»½
- **æ“ä½œç¯å¢ƒæ··ä¹±**ï¼šç”Ÿäº§ç¯å¢ƒç›´æ¥è¯•éªŒä¿®å¤æ–¹æ³•
- **ç¼ºä¹ä¸€è‡´æ€§éªŒè¯**ï¼šä¿®å¤åæœªéªŒè¯æ•°æ®ä¸€è‡´æ€§

### 8.4 æ•…éšœå¤„ç†å†³ç­–æ ‘


```
å‘ç°GTIDç©ºæ´
    â†“
è¯„ä¼°ä¸šåŠ¡å½±å“
    â†“
é«˜å½±å“ï¼Ÿ â€”â€”â€” Yes â€”â€”â†’ ç«‹å³å¤„ç† â€”â€”â†’ ç´§æ€¥ä¿®å¤æµç¨‹
    â†“ No
    â†“
åˆ¶å®šä¿®å¤è®¡åˆ’
    â†“
æµ‹è¯•ç¯å¢ƒéªŒè¯
    â†“
ç»´æŠ¤çª—å£æ‰§è¡Œ
    â†“
éªŒè¯ä¿®å¤ç»“æœ
    â†“
æ›´æ–°ç›‘æ§å‘Šè­¦
```

### 8.5 æŠ€èƒ½æå‡å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ æ–¹å‘**
- **GTIDåŸç†**ï¼šæ·±å…¥ç†è§£GTIDçš„å·¥ä½œæœºåˆ¶
- **å¤åˆ¶æ¶æ„**ï¼šæŒæ¡MySQLå¤åˆ¶çš„å®Œæ•´æ¶æ„
- **æ•…éšœæ’æŸ¥**ï¼šæå‡å¤åˆ¶æ•…éšœçš„è¯Šæ–­èƒ½åŠ›
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šå¼€å‘è‡ªåŠ¨åŒ–ç›‘æ§å’Œä¿®å¤å·¥å…·

**ğŸ› ï¸ å®è·µç»éªŒç§¯ç´¯**
- **æ­å»ºæµ‹è¯•ç¯å¢ƒ**ï¼šæ¨¡æ‹Ÿå„ç§ç©ºæ´åœºæ™¯
- **ç¼–å†™ç›‘æ§è„šæœ¬**ï¼šå¼€å‘é€‚åˆè‡ªå·±ç¯å¢ƒçš„ç›‘æ§å·¥å…·
- **æ¼”ç»ƒä¿®å¤æµç¨‹**ï¼šå®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
- **æ€»ç»“æœ€ä½³å®è·µ**ï¼šæ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–æ“ä½œæµç¨‹

**æ ¸å¿ƒè®°å¿†**ï¼š
- GTIDç©ºæ´å½±å“å¤åˆ¶è¿ç»­æ€§ï¼Œéœ€è¦åŠæ—¶å‘ç°å’Œå¤„ç†
- é¢„é˜²æ¯”ä¿®å¤æ›´é‡è¦ï¼Œé€šè¿‡ä¼˜åŒ–è®¾è®¡é¿å…ç©ºæ´äº§ç”Ÿ
- ä¿®å¤æ“ä½œè¦è°¨æ…å®‰å…¨ï¼Œå……åˆ†è¯„ä¼°ååœ¨åˆé€‚æ—¶æœºæ‰§è¡Œ
- å»ºç«‹å®Œå–„çš„ç›‘æ§å‘Šè­¦æœºåˆ¶ï¼Œç¡®ä¿é—®é¢˜åŠæ—¶å‘ç°å’Œå¤„ç†

**ğŸ’¡ ä¸€å¥è¯ç²¾é«“**
> GTIDç©ºæ´å°±åƒæ•°æ®æµæ°´çº¿ä¸Šçš„æ–­ç‚¹ï¼Œéœ€è¦ç”¨æ­£ç¡®çš„æ–¹æ³•å®‰å…¨åœ°"æ¥ä¸Š"ï¼Œæ—¢è¦ä¿è¯æ•°æ®å®Œæ•´æ€§ï¼Œåˆè¦ä¿è¯ä¸šåŠ¡è¿ç»­æ€§ã€‚