---
title: 12ã€å®¹é”™ç³»ç»Ÿè®¾è®¡æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [å®¹é”™ç³»ç»Ÿè®¾è®¡æ¨¡å¼æ¦‚è¿°](#1-å®¹é”™ç³»ç»Ÿè®¾è®¡æ¨¡å¼æ¦‚è¿°)
2. [è¶…æ—¶é‡è¯•æ¨¡å¼](#2-è¶…æ—¶é‡è¯•æ¨¡å¼)
3. [æ–­è·¯å™¨æ¨¡å¼](#3-æ–­è·¯å™¨æ¨¡å¼)
4. [èˆ±å£éš”ç¦»æ¨¡å¼](#4-èˆ±å£éš”ç¦»æ¨¡å¼)
5. [å¼‚æ­¥å¤„ç†æ¨¡å¼](#5-å¼‚æ­¥å¤„ç†æ¨¡å¼)
6. [è¡¥å¿äº‹åŠ¡æ¨¡å¼](#6-è¡¥å¿äº‹åŠ¡æ¨¡å¼)
7. [å¹‚ç­‰æ€§è®¾è®¡](#7-å¹‚ç­‰æ€§è®¾è®¡)
8. [ä¼˜é›…é™çº§æ¨¡å¼](#8-ä¼˜é›…é™çº§æ¨¡å¼)
9. [æ•…éšœå¿«é€Ÿæ¢å¤æ¨¡å¼](#9-æ•…éšœå¿«é€Ÿæ¢å¤æ¨¡å¼)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ å®¹é”™ç³»ç»Ÿè®¾è®¡æ¨¡å¼æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å®¹é”™ç³»ç»Ÿè®¾è®¡æ¨¡å¼


**ğŸ“– å®¹é”™ç³»ç»Ÿ**å°±åƒæ˜¯ç»™ä½ çš„MySQLæ•°æ®åº“ç³»ç»Ÿç©¿ä¸Šä¸€å¥—"é“ ç”²"ï¼Œå½“ç³»ç»Ÿé‡åˆ°æ•…éšœæ—¶ï¼Œä¸ä¼šç«‹å³å€’ä¸‹ï¼Œè€Œæ˜¯èƒ½å¤Ÿ**è‡ªåŠ¨å¤„ç†å¼‚å¸¸æƒ…å†µ**ï¼Œä¿è¯æœåŠ¡ç»§ç»­è¿è¡Œã€‚

```
ç®€å•ç±»æ¯”ï¼š
æ™®é€šç³»ç»Ÿ = ç»ç’ƒæ¯
  â†“ ä¸€æ‘”å°±ç¢
  
å®¹é”™ç³»ç»Ÿ = ä¸é”ˆé’¢ä¿æ¸©æ¯  
  â†“ æ‘”äº†è¿˜èƒ½ç”¨ï¼Œé‡Œé¢çš„æ°´ä¸ä¼šæ´’
```

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦å®¹é”™è®¾è®¡**ï¼š
- **ç¡¬ä»¶ä¼šå**ï¼šæœåŠ¡å™¨å®•æœºã€ç½‘ç»œæ–­å¼€ã€ç£ç›˜æŸå
- **è½¯ä»¶æœ‰bug**ï¼šç¨‹åºå¼‚å¸¸ã€å†…å­˜æ³„æ¼ã€æ­»é”
- **å¤–éƒ¨ä¾èµ–ä¸ç¨³å®š**ï¼šç¬¬ä¸‰æ–¹æœåŠ¡æ•…éšœã€ç½‘ç»œå»¶è¿Ÿ
- **äººä¸ºæ“ä½œé”™è¯¯**ï¼šè¯¯åˆ æ•°æ®ã€é…ç½®é”™è¯¯

### 1.2 å®¹é”™è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³


**ğŸ’¡ å®¹é”™è®¾è®¡ä¸‰å¤§åŸåˆ™**ï¼š

| åŸåˆ™ | **å«ä¹‰** | **å®é™…åšæ³•** |
|------|---------|-------------|
| **ğŸ”„ æ•…éšœéš”ç¦»** | `ä¸€ä¸ªåœ°æ–¹å‡ºé”™ï¼Œä¸å½±å“å…¶ä»–åœ°æ–¹` | `æŠŠç³»ç»Ÿåˆ†æˆç‹¬ç«‹çš„å°å—` |
| **âš¡ å¿«é€Ÿæ¢å¤** | `å‡ºäº†é—®é¢˜è¦èƒ½å¿«é€Ÿä¿®å¤` | `è‡ªåŠ¨é‡è¯•ã€è‡ªåŠ¨åˆ‡æ¢` |
| **ğŸ“Š çŠ¶æ€ç›‘æ§** | `éšæ—¶çŸ¥é“ç³»ç»Ÿå¥åº·çŠ¶å†µ` | `å®æ—¶ç›‘æ§ã€å‘Šè­¦é€šçŸ¥` |

### 1.3 MySQLç¯å¢ƒä¸­çš„å®¹é”™æŒ‘æˆ˜


**ğŸ­ MySQLå¤åˆ¶ç¯å¢ƒçš„ç‰¹æ®Šæ€§**ï¼š
```
ä¸»ä»å¤åˆ¶æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å¤åˆ¶    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»åº“    â”‚ ========> â”‚   ä»åº“    â”‚
â”‚  Master  â”‚           â”‚   Slave   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                      â†‘
  åº”ç”¨å†™å…¥               åº”ç”¨è¯»å–

å¯èƒ½çš„æ•…éšœç‚¹ï¼š
â€¢ ä¸»åº“å®•æœº â†’ å†™å…¥æ— æ³•è¿›è¡Œ
â€¢ ä»åº“å®•æœº â†’ è¯»å–å‹åŠ›é›†ä¸­åˆ°ä¸»åº“
â€¢ ç½‘ç»œæ•…éšœ â†’ ä¸»ä»åŒæ­¥ä¸­æ–­
â€¢ å¤åˆ¶å»¶è¿Ÿ â†’ æ•°æ®ä¸ä¸€è‡´
```

---

## 2. â° è¶…æ—¶é‡è¯•æ¨¡å¼


### 2.1 ä»€ä¹ˆæ˜¯è¶…æ—¶é‡è¯•æ¨¡å¼


**ğŸ“ è¶…æ—¶é‡è¯•**å°±åƒæ‰“ç”µè¯æ—¶å¯¹æ–¹æ²¡æ¥ï¼Œä½ ä¼š**ç­‰ä¸€ä¼šå„¿å†æ‰“**ï¼Œè€Œä¸æ˜¯ç«‹å³æ”¾å¼ƒã€‚

**ğŸ”§ å·¥ä½œåŸç†**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
åº”ç”¨ â†’ MySQL â†’ è¿”å›ç»“æœ âœ…

å¼‚å¸¸æƒ…å†µï¼š
åº”ç”¨ â†’ MySQL â†’ è¶…æ—¶/å¤±è´¥ âŒ
  â†“
ç­‰å¾…ä¸€æ®µæ—¶é—´
  â†“  
åº”ç”¨ â†’ MySQL â†’ é‡è¯• â†’ æˆåŠŸ âœ…
```

### 2.2 MySQLè¶…æ—¶é‡è¯•å®ç°


**âš™ï¸ æ•°æ®åº“è¿æ¥è¶…æ—¶é…ç½®**ï¼š
```sql
-- MySQLè¿æ¥è¶…æ—¶è®¾ç½®
SET SESSION wait_timeout = 30;           -- ç©ºé—²è¿æ¥è¶…æ—¶(ç§’)
SET SESSION interactive_timeout = 30;    -- äº¤äº’å¼è¿æ¥è¶…æ—¶
SET SESSION net_read_timeout = 10;       -- ç½‘ç»œè¯»å–è¶…æ—¶
SET SESSION net_write_timeout = 10;      -- ç½‘ç»œå†™å…¥è¶…æ—¶
```

**ğŸ’» Javaåº”ç”¨å±‚é‡è¯•ç¤ºä¾‹**ï¼š
```java
public class MySQLRetryHandler {
    private static final int MAX_RETRY = 3;        // æœ€å¤§é‡è¯•æ¬¡æ•°
    private static final long RETRY_DELAY = 1000;  // é‡è¯•é—´éš”(æ¯«ç§’)
    
    public ResultSet executeWithRetry(String sql) {
        int attempts = 0;
        
        while (attempts < MAX_RETRY) {
            try {
                // æ‰§è¡ŒSQLæŸ¥è¯¢
                Connection conn = getConnection();
                PreparedStatement stmt = conn.prepareStatement(sql);
                return stmt.executeQuery();
                
            } catch (SQLException e) {
                attempts++;
                
                if (isRetryableError(e) && attempts < MAX_RETRY) {
                    // å¯é‡è¯•çš„é”™è¯¯ï¼Œç­‰å¾…åé‡è¯•
                    System.out.println("ç¬¬" + attempts + "æ¬¡é‡è¯•ï¼Œé”™è¯¯ï¼š" + e.getMessage());
                    Thread.sleep(RETRY_DELAY * attempts); // é€’å¢å»¶è¿Ÿ
                } else {
                    // ä¸å¯é‡è¯•æˆ–è¶…è¿‡æœ€å¤§æ¬¡æ•°
                    throw new RuntimeException("é‡è¯•å¤±è´¥", e);
                }
            }
        }
        return null;
    }
    
    // åˆ¤æ–­æ˜¯å¦ä¸ºå¯é‡è¯•çš„é”™è¯¯
    private boolean isRetryableError(SQLException e) {
        int errorCode = e.getErrorCode();
        return errorCode == 2006 ||  // MySQL server has gone away
               errorCode == 2013 ||  // Lost connection to MySQL server
               errorCode == 1213;    // Deadlock found when trying to get lock
    }
}
```

### 2.3 é‡è¯•ç­–ç•¥è¯¦è§£


**ğŸ“Š å¸¸è§é‡è¯•ç­–ç•¥å¯¹æ¯”**ï¼š

| ç­–ç•¥ç±»å‹ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **é£é™©** |
|---------|---------|-------------|---------|
| **ğŸ”„ å›ºå®šé—´éš”** | `æ¯æ¬¡éƒ½ç­‰ç›¸åŒæ—¶é—´` | `è½»å¾®ç½‘ç»œæŠ–åŠ¨` | `å¯èƒ½åŠ é‡ç³»ç»Ÿè´Ÿæ‹…` |
| **ğŸ“ˆ é€’å¢å»¶è¿Ÿ** | `æ¯æ¬¡ç­‰å¾…æ—¶é—´é€’å¢` | `ç³»ç»Ÿè´Ÿè½½è¿‡é«˜` | `æ¢å¤æ—¶é—´è¾ƒé•¿` |
| **ğŸ² éšæœºå»¶è¿Ÿ** | `éšæœºç­‰å¾…æ—¶é—´` | `é¿å…é›ªå´©æ•ˆåº”` | `ä¸å¥½é¢„æµ‹æ¢å¤æ—¶é—´` |

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
```java
// æŒ‡æ•°é€€é¿ + éšæœºæŠ–åŠ¨
public long calculateRetryDelay(int attempt) {
    long baseDelay = 1000; // åŸºç¡€å»¶è¿Ÿ1ç§’
    long maxDelay = 30000; // æœ€å¤§å»¶è¿Ÿ30ç§’
    
    // æŒ‡æ•°é€€é¿: 2^attempt * baseDelay
    long delay = Math.min(baseDelay * (1L << attempt), maxDelay);
    
    // æ·»åŠ éšæœºæŠ–åŠ¨ Â±25%
    double jitter = 0.25;
    long minDelay = (long) (delay * (1 - jitter));
    long maxDelayWithJitter = (long) (delay * (1 + jitter));
    
    return ThreadLocalRandom.current().nextLong(minDelay, maxDelayWithJitter);
}
```

### 2.4 è¶…æ—¶é‡è¯•æ³¨æ„äº‹é¡¹


> âš ï¸ **é‡è¦æé†’**ï¼š
> - **å¹‚ç­‰æ€§è¦æ±‚**ï¼šé‡è¯•çš„æ“ä½œå¿…é¡»æ˜¯å¹‚ç­‰çš„ï¼ˆå¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒï¼‰
> - **è¶…æ—¶æ—¶é—´è®¾ç½®**ï¼šä¸èƒ½å¤ªçŸ­ï¼ˆè¯¯åˆ¤ï¼‰ä¹Ÿä¸èƒ½å¤ªé•¿ï¼ˆå½±å“ç”¨æˆ·ä½“éªŒï¼‰
> - **é‡è¯•æ¬¡æ•°é™åˆ¶**ï¼šé¿å…æ— é™é‡è¯•æ¶ˆè€—èµ„æº
> - **ç›‘æ§å‘Šè­¦**ï¼šè®°å½•é‡è¯•æ¬¡æ•°å’ŒæˆåŠŸç‡

---

## 3. ğŸ”Œ æ–­è·¯å™¨æ¨¡å¼


### 3.1 ä»€ä¹ˆæ˜¯æ–­è·¯å™¨æ¨¡å¼


**ğŸ  æ–­è·¯å™¨**å°±åƒå®¶é‡Œçš„ç©ºæ°”å¼€å…³ï¼Œå½“ç”µè·¯å‡ºç°é—®é¢˜æ—¶ä¼š**è‡ªåŠ¨æ–­å¼€**ä¿æŠ¤å®¶é‡Œçš„ç”µå™¨ï¼Œç­‰é—®é¢˜è§£å†³åå†åˆä¸Šå¼€å…³ã€‚

**ğŸ¯ æ•°æ®åº“æ–­è·¯å™¨çš„ä½œç”¨**ï¼š
```
æ­£å¸¸çŠ¶æ€ï¼ˆé—­åˆï¼‰ï¼š
åº”ç”¨ â†â†’ æ•°æ®åº“ âœ… æ­£å¸¸è®¿é—®

æ•…éšœçŠ¶æ€ï¼ˆæ–­å¼€ï¼‰ï¼š  
åº”ç”¨ â†âœ—â†’ æ•°æ®åº“ âŒ ç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸è®¿é—®æ•°æ®åº“

åŠå¼€çŠ¶æ€ï¼ˆæ¢æµ‹ï¼‰ï¼š
åº”ç”¨ â†ï¼Ÿâ†’ æ•°æ®åº“ ğŸ” å°‘é‡è¯·æ±‚æµ‹è¯•æ¢å¤æƒ…å†µ
```

### 3.2 æ–­è·¯å™¨çŠ¶æ€è½¬æ¢


**ğŸ”„ ä¸‰ç§çŠ¶æ€åŠè½¬æ¢æ¡ä»¶**ï¼š
```
           æ•…éšœç‡è¶…é˜ˆå€¼
    CLOSED ============> OPEN
       â†‘                  â†“
       |               è¶…æ—¶æ—¶é—´åˆ°
       |                  â†“
       ========== HALF_OPEN
         æµ‹è¯•æˆåŠŸ    â†‘
                  æµ‹è¯•å¤±è´¥
```

**ğŸ“Š çŠ¶æ€è¯¦è§£**ï¼š

| çŠ¶æ€ | **å«ä¹‰** | **è¡Œä¸º** | **è½¬æ¢æ¡ä»¶** |
|------|---------|---------|-------------|
| **ğŸŸ¢ CLOSED** | `æ­£å¸¸å·¥ä½œ` | `æ­£å¸¸è½¬å‘è¯·æ±‚` | `æ•…éšœç‡ > é˜ˆå€¼ â†’ OPEN` |
| **ğŸ”´ OPEN** | `æœåŠ¡æ•…éšœ` | `ç›´æ¥è¿”å›é”™è¯¯` | `ç­‰å¾…æ—¶é—´åˆ° â†’ HALF_OPEN` |
| **ğŸŸ¡ HALF_OPEN** | `è¯•æ¢æ¢å¤` | `å°‘é‡è¯·æ±‚æµ‹è¯•` | `æˆåŠŸ â†’ CLOSEDï¼Œå¤±è´¥ â†’ OPEN` |

### 3.3 MySQLæ–­è·¯å™¨å®ç°


**ğŸ’» ç®€åŒ–ç‰ˆæ–­è·¯å™¨å®ç°**ï¼š
```java
public class MySQLCircuitBreaker {
    // æ–­è·¯å™¨çŠ¶æ€
    private enum State { CLOSED, OPEN, HALF_OPEN }
    
    private State state = State.CLOSED;
    private int failureCount = 0;           // å¤±è´¥è®¡æ•°
    private long lastFailureTime = 0;       // æœ€åå¤±è´¥æ—¶é—´
    
    // é…ç½®å‚æ•°
    private final int failureThreshold = 5;    // å¤±è´¥é˜ˆå€¼
    private final long timeout = 60000;        // è¶…æ—¶æ—¶é—´(æ¯«ç§’)
    private final int successThreshold = 3;    // æˆåŠŸé˜ˆå€¼(åŠå¼€çŠ¶æ€)
    
    public Object execute(Callable<Object> operation) throws Exception {
        if (state == State.OPEN) {
            // æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›å…¥åŠå¼€çŠ¶æ€
            if (System.currentTimeMillis() - lastFailureTime >= timeout) {
                state = State.HALF_OPEN;
                System.out.println("æ–­è·¯å™¨è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œå¼€å§‹æµ‹è¯•");
            } else {
                throw new RuntimeException("æ–­è·¯å™¨å¼€å¯ï¼ŒæœåŠ¡ä¸å¯ç”¨");
            }
        }
        
        try {
            // æ‰§è¡Œæ“ä½œ
            Object result = operation.call();
            onSuccess();
            return result;
            
        } catch (Exception e) {
            onFailure();
            throw e;
        }
    }
    
    private void onSuccess() {
        failureCount = 0;
        if (state == State.HALF_OPEN) {
            state = State.CLOSED;
            System.out.println("æœåŠ¡æ¢å¤ï¼Œæ–­è·¯å™¨å…³é—­");
        }
    }
    
    private void onFailure() {
        failureCount++;
        lastFailureTime = System.currentTimeMillis();
        
        if (failureCount >= failureThreshold) {
            state = State.OPEN;
            System.out.println("æ•…éšœæ¬¡æ•°è¶…é˜ˆå€¼ï¼Œæ–­è·¯å™¨å¼€å¯");
        }
    }
}
```

### 3.4 æ–­è·¯å™¨åœ¨MySQLåœºæ™¯ä¸­çš„åº”ç”¨


**ğŸ® å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// ä¸»ä»åˆ‡æ¢çš„æ–­è·¯å™¨åº”ç”¨
public class DatabaseService {
    private CircuitBreaker masterBreaker = new MySQLCircuitBreaker();
    private CircuitBreaker slaveBreaker = new MySQLCircuitBreaker();
    
    public User getUserById(Long id) {
        try {
            // ä¼˜å…ˆä»ä»åº“è¯»å–
            return (User) slaveBreaker.execute(() -> {
                return slaveDao.findById(id);
            });
        } catch (Exception e) {
            // ä»åº“å¤±è´¥ï¼Œåˆ‡æ¢åˆ°ä¸»åº“
            System.out.println("ä»åº“ä¸å¯ç”¨ï¼Œåˆ‡æ¢åˆ°ä¸»åº“è¯»å–");
            return (User) masterBreaker.execute(() -> {
                return masterDao.findById(id);
            });
        }
    }
}
```

**ğŸ’¡ æ–­è·¯å™¨çš„å¥½å¤„**ï¼š
- **é˜²æ­¢çº§è”æ•…éšœ**ï¼šä¸€ä¸ªæ•°æ®åº“æ•…éšœä¸ä¼šæ‹–å®æ•´ä¸ªç³»ç»Ÿ
- **å¿«é€Ÿå¤±è´¥**ï¼šä¸ç­‰å¾…è¶…æ—¶ï¼Œç«‹å³è¿”å›é”™è¯¯
- **è‡ªåŠ¨æ¢å¤**ï¼šç³»ç»Ÿæ¢å¤åè‡ªåŠ¨åˆ‡å›æ­£å¸¸çŠ¶æ€
- **èµ„æºä¿æŠ¤**ï¼šé¿å…æ— æ•ˆè¯·æ±‚æ¶ˆè€—ç³»ç»Ÿèµ„æº

---

## 4. ğŸš¢ èˆ±å£éš”ç¦»æ¨¡å¼


### 4.1 ä»€ä¹ˆæ˜¯èˆ±å£éš”ç¦»æ¨¡å¼


**â›µ èˆ±å£éš”ç¦»**çš„æ¦‚å¿µæ¥è‡ªè½®èˆ¹è®¾è®¡ï¼šèˆ¹ä½“è¢«åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„èˆ±å®¤ï¼Œå³ä½¿ä¸€ä¸ªèˆ±å®¤è¿›æ°´ï¼Œå…¶ä»–èˆ±å®¤ä»ç„¶å®‰å…¨ï¼Œèˆ¹åªä¸ä¼šæ²‰æ²¡ã€‚

**ğŸ—ï¸ åœ¨ç³»ç»Ÿä¸­çš„åº”ç”¨**ï¼š
```
ä¼ ç»Ÿå•ä¸€è¿æ¥æ± ï¼š
åº”ç”¨ â†’ [â•â•â•â•â•è¿æ¥æ± â•â•â•â•â•] â†’ MySQL
         æ‰€æœ‰è¯·æ±‚å…±äº«
      â†“ ä¸€æ—¦å‡ºé—®é¢˜ï¼Œå…¨éƒ¨å—å½±å“

èˆ±å£éš”ç¦»åï¼š
       â†’ [å…³é”®ä¸šåŠ¡è¿æ¥æ± ] â†’ MySQL
åº”ç”¨ â†’ [æ™®é€šä¸šåŠ¡è¿æ¥æ± ] â†’ MySQL  
       â†’ [æŠ¥è¡¨æŸ¥è¯¢è¿æ¥æ± ] â†’ MySQL
    â†‘ æ¯ä¸ªä¸šåŠ¡ç‹¬ç«‹ï¼Œäº’ä¸å½±å“
```

### 4.2 MySQLè¿æ¥æ± éš”ç¦»è®¾è®¡


**ğŸ¯ æŒ‰ä¸šåŠ¡ç±»å‹éš”ç¦»è¿æ¥æ± **ï¼š
```java
@Configuration
public class DataSourceConfig {
    
    // æ ¸å¿ƒä¸šåŠ¡è¿æ¥æ±  - é«˜ä¼˜å…ˆçº§
    @Bean("coreDataSource")
    public DataSource coreDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/core_db");
        config.setMaximumPoolSize(20);          // æ ¸å¿ƒä¸šåŠ¡ä¿è¯è¶³å¤Ÿè¿æ¥
        config.setMinimumIdle(10);              // ä¿æŒæœ€å°ç©ºé—²è¿æ¥
        config.setConnectionTimeout(5000);      // è¿æ¥è¶…æ—¶5ç§’
        config.setPoolName("CorePool");
        return new HikariDataSource(config);
    }
    
    // æŠ¥è¡¨ä¸šåŠ¡è¿æ¥æ±  - ä½ä¼˜å…ˆçº§
    @Bean("reportDataSource")  
    public DataSource reportDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/report_db");
        config.setMaximumPoolSize(5);           // æŠ¥è¡¨ä¸šåŠ¡é™åˆ¶è¿æ¥æ•°
        config.setMinimumIdle(2);
        config.setConnectionTimeout(10000);     // å¯ä»¥ç­‰å¾…æ›´é•¿æ—¶é—´
        config.setPoolName("ReportPool");
        return new HikariDataSource(config);
    }
}
```

### 4.3 çº¿ç¨‹æ± éš”ç¦»


**ğŸ§µ æŒ‰ä¸šåŠ¡éš”ç¦»çº¿ç¨‹æ± **ï¼š
```java
@Component
public class BusinessThreadPools {
    
    // æ ¸å¿ƒä¸šåŠ¡çº¿ç¨‹æ± 
    private final ThreadPoolExecutor corePool = new ThreadPoolExecutor(
        10,                              // æ ¸å¿ƒçº¿ç¨‹æ•°
        20,                              // æœ€å¤§çº¿ç¨‹æ•°  
        60L, TimeUnit.SECONDS,           // ç©ºé—²æ—¶é—´
        new LinkedBlockingQueue<>(100),   // ä»»åŠ¡é˜Ÿåˆ—
        new ThreadFactory() {            // çº¿ç¨‹å·¥å‚
            private AtomicInteger counter = new AtomicInteger(0);
            public Thread newThread(Runnable r) {
                return new Thread(r, "core-thread-" + counter.incrementAndGet());
            }
        }
    );
    
    // æŠ¥è¡¨ä¸šåŠ¡çº¿ç¨‹æ±   
    private final ThreadPoolExecutor reportPool = new ThreadPoolExecutor(
        2,                               // æ ¸å¿ƒçº¿ç¨‹æ•°è¾ƒå°‘
        5,                               // æœ€å¤§çº¿ç¨‹æ•°è¾ƒå°‘
        60L, TimeUnit.SECONDS,
        new LinkedBlockingQueue<>(50),    // é˜Ÿåˆ—ä¹Ÿè¾ƒå°
        new ThreadFactory() {
            private AtomicInteger counter = new AtomicInteger(0);
            public Thread newThread(Runnable r) {
                return new Thread(r, "report-thread-" + counter.incrementAndGet());
            }
        }
    );
    
    public void executeCoreTask(Runnable task) {
        corePool.execute(task);
    }
    
    public void executeReportTask(Runnable task) {
        reportPool.execute(task);
    }
}
```

### 4.4 èµ„æºéš”ç¦»ç›‘æ§


**ğŸ“Š éš”ç¦»æ•ˆæœç›‘æ§**ï¼š
```java
@Component
public class ResourceMonitor {
    
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void monitorPools() {
        // ç›‘æ§è¿æ¥æ± çŠ¶æ€
        HikariDataSource coreDs = (HikariDataSource) coreDataSource;
        HikariPoolMXBean corePool = coreDs.getHikariPoolMXBean();
        
        System.out.printf("æ ¸å¿ƒè¿æ¥æ±  - æ´»è·ƒè¿æ¥: %d, ç©ºé—²è¿æ¥: %d, ç­‰å¾…çº¿ç¨‹: %d%n",
            corePool.getActiveConnections(),
            corePool.getIdleConnections(), 
            corePool.getThreadsAwaitingConnection());
            
        // ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€
        ThreadPoolExecutor executor = (ThreadPoolExecutor) coreThreadPool;
        System.out.printf("æ ¸å¿ƒçº¿ç¨‹æ±  - æ´»è·ƒçº¿ç¨‹: %d, é˜Ÿåˆ—å¤§å°: %d%n",
            executor.getActiveCount(),
            executor.getQueue().size());
    }
}
```

**ğŸ’¡ èˆ±å£éš”ç¦»çš„å¥½å¤„**ï¼š
- **æ•…éšœéš”ç¦»**ï¼šä¸€ä¸ªä¸šåŠ¡å‡ºé—®é¢˜ä¸å½±å“å…¶ä»–ä¸šåŠ¡
- **èµ„æºä¿æŠ¤**ï¼šé‡è¦ä¸šåŠ¡ä¼˜å…ˆä¿éšœèµ„æº
- **æ€§èƒ½éš”ç¦»**ï¼šæ…¢æŸ¥è¯¢ä¸ä¼šæ‹–æ…¢å¿«æŸ¥è¯¢
- **å®¹é‡è§„åˆ’**ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒä¸šåŠ¡ç²¾ç¡®åˆ†é…èµ„æº

---

## 5. ğŸ”„ å¼‚æ­¥å¤„ç†æ¨¡å¼


### 5.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥å¤„ç†æ¨¡å¼


**ğŸ“® å¼‚æ­¥å¤„ç†**å°±åƒå¯„ä¿¡ï¼šä½ æŠŠä¿¡æŠ•åˆ°é‚®ç®±é‡Œå°±å¯ä»¥èµ°äº†ï¼Œä¸ç”¨ç­‰é‚®é€’å‘˜å–ä¿¡ã€é€ä¿¡ã€å¯¹æ–¹æ”¶ä¿¡çš„æ•´ä¸ªè¿‡ç¨‹ã€‚

**ğŸ”„ åŒæ­¥ vs å¼‚æ­¥å¯¹æ¯”**ï¼š
```
åŒæ­¥å¤„ç†ï¼ˆç­‰å¾…ç»“æœï¼‰ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ å¤„ç† â†’ æ•°æ®åº“æ“ä½œ â†’ ç­‰å¾… â†’ è¿”å›ç»“æœ
  â†‘___________________________|
       ç”¨æˆ·ä¸€ç›´ç­‰å¾…

å¼‚æ­¥å¤„ç†ï¼ˆç«‹å³å“åº”ï¼‰ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ä»»åŠ¡å…¥é˜Ÿ â†’ ç«‹å³è¿”å› "å¤„ç†ä¸­"
             â†“
        åå°å¤„ç† â†’ æ•°æ®åº“æ“ä½œ â†’ å®Œæˆé€šçŸ¥
```

### 5.2 MySQLå¼‚æ­¥å†™å…¥å®ç°


**ğŸ“ æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å†™å…¥**ï¼š
```java
@Service
public class AsyncDataService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired  
    private UserRepository userRepository;
    
    // å¼‚æ­¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯
    public String saveUserAsync(User user) {
        // ç”Ÿæˆä»»åŠ¡ID
        String taskId = UUID.randomUUID().toString();
        
        // ä»»åŠ¡ä¿¡æ¯æ”¾å…¥Redisé˜Ÿåˆ—
        Map<String, Object> task = new HashMap<>();
        task.put("taskId", taskId);
        task.put("type", "SAVE_USER");
        task.put("data", user);
        task.put("createTime", System.currentTimeMillis());
        
        // æŠ•é€’åˆ°å¼‚æ­¥é˜Ÿåˆ—
        redisTemplate.opsForList().leftPush("async_tasks", task);
        
        // ç«‹å³è¿”å›ä»»åŠ¡ID
        return taskId;
    }
    
    // æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
    public String getTaskStatus(String taskId) {
        String status = (String) redisTemplate.opsForValue().get("task_status:" + taskId);
        return status != null ? status : "PENDING";
    }
}
```

**âš™ï¸ å¼‚æ­¥ä»»åŠ¡å¤„ç†å™¨**ï¼š
```java
@Component
public class AsyncTaskProcessor {
    
    @EventListener
    @Async("taskExecutor")
    public void processAsyncTasks() {
        while (true) {
            try {
                // ä»é˜Ÿåˆ—å–ä»»åŠ¡
                Object task = redisTemplate.opsForList().rightPop("async_tasks", 1, TimeUnit.SECONDS);
                
                if (task != null) {
                    Map<String, Object> taskData = (Map<String, Object>) task;
                    String taskId = (String) taskData.get("taskId");
                    
                    try {
                        // æ›´æ–°çŠ¶æ€ä¸ºå¤„ç†ä¸­
                        redisTemplate.opsForValue().set("task_status:" + taskId, "PROCESSING");
                        
                        // æ‰§è¡Œå®é™…çš„æ•°æ®åº“æ“ä½œ
                        processTask(taskData);
                        
                        // æ›´æ–°çŠ¶æ€ä¸ºå®Œæˆ
                        redisTemplate.opsForValue().set("task_status:" + taskId, "COMPLETED");
                        
                    } catch (Exception e) {
                        // å¤„ç†å¤±è´¥
                        redisTemplate.opsForValue().set("task_status:" + taskId, "FAILED");
                        
                        // é‡è¯•æœºåˆ¶ï¼šæ”¾å›é˜Ÿåˆ—
                        if (shouldRetry(taskData)) {
                            redisTemplate.opsForList().leftPush("async_tasks", taskData);
                        }
                    }
                }
            } catch (Exception e) {
                Thread.sleep(1000); // å‘ç”Ÿå¼‚å¸¸æ—¶ä¼‘æ¯1ç§’
            }
        }
    }
    
    private void processTask(Map<String, Object> taskData) {
        String type = (String) taskData.get("type");
        
        switch (type) {
            case "SAVE_USER":
                User user = (User) taskData.get("data");
                userRepository.save(user);
                break;
            // å…¶ä»–ä»»åŠ¡ç±»å‹...
        }
    }
}
```

### 5.3 å¼‚æ­¥è¯»å–ä¼˜åŒ–


**ğŸš€ è¯»å†™åˆ†ç¦» + å¼‚æ­¥å¤åˆ¶å¤„ç†**ï¼š
```java
@Service
public class SmartDataService {
    
    @Autowired
    private DataSource masterDataSource;  // ä¸»åº“
    
    @Autowired
    private DataSource slaveDataSource;   // ä»åº“
    
    // æ™ºèƒ½è¯»å–ï¼šä¼˜å…ˆä»åº“ï¼Œå…œåº•ä¸»åº“
    public User getUserById(Long userId) {
        try {
            // å…ˆå°è¯•ä»ä»åº“è¯»å–ï¼ˆå¼‚æ­¥å¤åˆ¶å¯èƒ½æœ‰å»¶è¿Ÿï¼‰
            return readFromSlave(userId);
        } catch (Exception e) {
            // ä»åº“å¤±è´¥ï¼Œåˆ‡æ¢åˆ°ä¸»åº“
            return readFromMaster(userId);
        }
    }
    
    private User readFromSlave(Long userId) {
        // ä½¿ç”¨ä»åº“è¿æ¥
        try (Connection conn = slaveDataSource.getConnection()) {
            String sql = "SELECT * FROM users WHERE id = ?";
            PreparedStatement stmt = conn.prepareStatement(sql);
            stmt.setLong(1, userId);
            
            ResultSet rs = stmt.executeQuery();
            if (rs.next()) {
                return mapToUser(rs);
            }
            return null;
        }
    }
}
```

### 5.4 å¼‚æ­¥å¤„ç†çš„æ³¨æ„äº‹é¡¹


> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼š
> - **å¹‚ç­‰æ€§è®¾è®¡**ï¼šåŒä¸€ä¸ªä»»åŠ¡å¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒ
> - **ä»»åŠ¡æŒä¹…åŒ–**ï¼šä»»åŠ¡ä¿¡æ¯è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œé¿å…ä¸¢å¤±
> - **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§é˜Ÿåˆ—ç§¯å‹ã€å¤„ç†å¤±è´¥ç‡
> - **ä¼˜é›…å…³æœº**ï¼šç³»ç»Ÿå…³é—­æ—¶è¦ç­‰å¾…ä»»åŠ¡å®Œæˆ

**âš ï¸ å¼‚æ­¥å¤„ç†çš„æƒè¡¡**ï¼š
- âœ… **ä¼˜ç‚¹**ï¼šæé«˜å“åº”é€Ÿåº¦ã€å‰Šå³°å¡«è°·ã€è§£è€¦ç³»ç»Ÿ
- âŒ **ç¼ºç‚¹**ï¼šå¢åŠ å¤æ‚æ€§ã€æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜ã€è°ƒè¯•å›°éš¾

---

## 6. ğŸ’° è¡¥å¿äº‹åŠ¡æ¨¡å¼


### 6.1 ä»€ä¹ˆæ˜¯è¡¥å¿äº‹åŠ¡æ¨¡å¼


**ğŸ”„ è¡¥å¿äº‹åŠ¡**å°±åƒ"åæ‚”è¯"ï¼šå½“ä¸€ç³»åˆ—æ“ä½œæ‰§è¡Œåˆ°ä¸€åŠå‡ºç°é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿ**æ’¤é”€ä¹‹å‰å·²ç»å®Œæˆçš„æ“ä½œ**ï¼Œè®©ç³»ç»Ÿå›åˆ°åŸæ¥çš„çŠ¶æ€ã€‚

**ğŸª ç”Ÿæ´»åœºæ™¯ç±»æ¯”**ï¼š
```
ç½‘è´­æµç¨‹ï¼š
1. æ‰£å‡åº“å­˜ âœ…
2. åˆ›å»ºè®¢å• âœ…  
3. æ‰£å‡ä½™é¢ âœ…
4. å‘é€çŸ­ä¿¡ âŒ (å¤±è´¥)

è¡¥å¿æ“ä½œï¼š
4. çŸ­ä¿¡å‘é€å¤±è´¥ â†’ å¼€å§‹è¡¥å¿
3. é€€è¿˜ä½™é¢ âœ…
2. å–æ¶ˆè®¢å• âœ…
1. æ¢å¤åº“å­˜ âœ…
```

### 6.2 MySQLäº‹åŠ¡è¡¥å¿å®ç°


**ğŸ”§ è¡¥å¿äº‹åŠ¡ç®¡ç†å™¨**ï¼š
```java
@Component
public class CompensationTransactionManager {
    
    // è¡¥å¿åŠ¨ä½œæ¥å£
    public interface CompensationAction {
        void compensate() throws Exception;
    }
    
    // äº‹åŠ¡ä¸Šä¸‹æ–‡
    public static class TransactionContext {
        private List<CompensationAction> compensations = new ArrayList<>();
        private boolean completed = false;
        
        public void addCompensation(CompensationAction action) {
            compensations.add(action);
        }
        
        public void complete() {
            completed = true;
        }
        
        public void compensate() {
            if (!completed) {
                // æŒ‰ç›¸åé¡ºåºæ‰§è¡Œè¡¥å¿åŠ¨ä½œ
                for (int i = compensations.size() - 1; i >= 0; i--) {
                    try {
                        compensations.get(i).compensate();
                    } catch (Exception e) {
                        System.err.println("è¡¥å¿æ“ä½œå¤±è´¥: " + e.getMessage());
                    }
                }
            }
        }
    }
    
    // æ‰§è¡Œå¸¦è¡¥å¿çš„äº‹åŠ¡
    public <T> T executeWithCompensation(Supplier<T> mainAction) {
        TransactionContext context = new TransactionContext();
        
        try {
            T result = mainAction.get();
            context.complete();
            return result;
            
        } catch (Exception e) {
            // ä¸»æµç¨‹å¤±è´¥ï¼Œæ‰§è¡Œè¡¥å¿
            context.compensate();
            throw new RuntimeException("äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œå·²æ‰§è¡Œè¡¥å¿", e);
        }
    }
}
```

**ğŸ’» å…·ä½“ä¸šåŠ¡ç¤ºä¾‹**ï¼š
```java
@Service
public class OrderService {
    
    @Autowired
    private CompensationTransactionManager compensationManager;
    
    public Order createOrder(OrderRequest request) {
        return compensationManager.executeWithCompensation(() -> {
            TransactionContext context = new TransactionContext();
            
            // æ­¥éª¤1: æ‰£å‡åº“å­˜
            Product product = productService.decreaseStock(request.getProductId(), request.getQuantity());
            context.addCompensation(() -> {
                // è¡¥å¿ï¼šæ¢å¤åº“å­˜
                productService.increaseStock(request.getProductId(), request.getQuantity());
                System.out.println("å·²æ¢å¤åº“å­˜: " + request.getQuantity());
            });
            
            // æ­¥éª¤2: åˆ›å»ºè®¢å•
            Order order = new Order();
            order.setUserId(request.getUserId());
            order.setProductId(request.getProductId());
            order.setAmount(product.getPrice() * request.getQuantity());
            orderRepository.save(order);
            
            context.addCompensation(() -> {
                // è¡¥å¿ï¼šåˆ é™¤è®¢å•
                orderRepository.deleteById(order.getId());
                System.out.println("å·²åˆ é™¤è®¢å•: " + order.getId());
            });
            
            // æ­¥éª¤3: æ‰£å‡ç”¨æˆ·ä½™é¢
            userService.deductBalance(request.getUserId(), order.getAmount());
            context.addCompensation(() -> {
                // è¡¥å¿ï¼šé€€è¿˜ä½™é¢
                userService.addBalance(request.getUserId(), order.getAmount());
                System.out.println("å·²é€€è¿˜ä½™é¢: " + order.getAmount());
            });
            
            // æ­¥éª¤4: å‘é€é€šçŸ¥ï¼ˆå¯èƒ½å¤±è´¥çš„æ­¥éª¤ï¼‰
            notificationService.sendOrderNotification(order);
            
            return order;
        });
    }
}
```

### 6.3 åˆ†å¸ƒå¼è¡¥å¿äº‹åŠ¡


**ğŸŒ è·¨æœåŠ¡çš„è¡¥å¿äº‹åŠ¡**ï¼š
```java
@Service
public class DistributedOrderService {
    
    public void processOrder(OrderRequest request) {
        SagaTransactionContext saga = new SagaTransactionContext();
        
        try {
            // åº“å­˜æœåŠ¡
            saga.addStep(
                () -> inventoryService.reserve(request.getProductId(), request.getQuantity()),
                () -> inventoryService.cancel(request.getProductId(), request.getQuantity())
            );
            
            // æ”¯ä»˜æœåŠ¡  
            saga.addStep(
                () -> paymentService.charge(request.getUserId(), request.getAmount()),
                () -> paymentService.refund(request.getUserId(), request.getAmount())
            );
            
            // è®¢å•æœåŠ¡
            saga.addStep(
                () -> orderService.create(request),
                () -> orderService.cancel(request.getOrderId())
            );
            
            // æ‰§è¡Œæ‰€æœ‰æ­¥éª¤
            saga.execute();
            
        } catch (Exception e) {
            // ä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œæ‰§è¡Œè¡¥å¿
            saga.compensate();
            throw e;
        }
    }
}
```

### 6.4 è¡¥å¿äº‹åŠ¡çš„è®¾è®¡åŸåˆ™


**ğŸ“‹ è¡¥å¿æ“ä½œè®¾è®¡è¦ç‚¹**ï¼š

| åŸåˆ™ | **è¯´æ˜** | **ç¤ºä¾‹** |
|------|---------|---------|
| **ğŸ”„ å¯è¡¥å¿æ€§** | `æ¯ä¸ªæ“ä½œéƒ½è¦æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œ` | `æ‰£æ¬¾ â†” é€€æ¬¾` |
| **ğŸ¯ å¹‚ç­‰æ€§** | `è¡¥å¿æ“ä½œå¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒ` | `é‡å¤é€€æ¬¾è¦åˆ¤æ–­çŠ¶æ€` |
| **ğŸ“ å¯è§‚æµ‹æ€§** | `è®°å½•æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡ŒçŠ¶æ€` | `æ—¥å¿—è®°å½•ã€çŠ¶æ€è¿½è¸ª` |
| **âš¡ æœ€ç»ˆä¸€è‡´æ€§** | `å…è®¸ä¸­é—´çŠ¶æ€ä¸ä¸€è‡´ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€è‡´` | `å¼‚æ­¥è¡¥å¿é€æ­¥ä¿®æ­£` |

---

## 7. ğŸ”‘ å¹‚ç­‰æ€§è®¾è®¡


### 7.1 ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§


**ğŸ¯ å¹‚ç­‰æ€§**çš„æ„æ€æ˜¯ï¼š**åŒä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤šæ¬¡ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„**ã€‚å°±åƒæŒ‰ç”µæ¢¯æŒ‰é’®ï¼Œä¸ç®¡æŒ‰å‡ æ¬¡ï¼Œç”µæ¢¯éƒ½åªä¼šæ¥ä¸€æ¬¡ã€‚

**ğŸ“Š å¹‚ç­‰ vs éå¹‚ç­‰æ“ä½œå¯¹æ¯”**ï¼š

| æ“ä½œç±»å‹ | **å¹‚ç­‰ç¤ºä¾‹** | **éå¹‚ç­‰ç¤ºä¾‹** |
|---------|-------------|---------------|
| **æ•°å­¦è¿ç®—** | `x = 5ï¼ˆèµ‹å€¼ï¼‰` | `x = x + 1ï¼ˆè‡ªå¢ï¼‰` |
| **æ•°æ®åº“** | `UPDATE user SET name='å¼ ä¸‰' WHERE id=1` | `UPDATE user SET balance=balance+100 WHERE id=1` |
| **HTTPè¯·æ±‚** | `GET /user/123` | `POST /user/transfer` |

### 7.2 MySQLå¹‚ç­‰æ€§å®ç°æ–¹æ³•


**ğŸ”§ æ–¹æ³•ä¸€ï¼šå”¯ä¸€çº¦æŸé˜²é‡å¤**ï¼š
```sql
-- åˆ›å»ºæ”¯ä»˜è®°å½•è¡¨ï¼Œä½¿ç”¨å¤åˆå”¯ä¸€ç´¢å¼•
CREATE TABLE payment_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    order_id VARCHAR(50) NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) NOT NULL,
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å”¯ä¸€çº¦æŸï¼šåŒä¸€ç”¨æˆ·åŒä¸€è®¢å•åªèƒ½æœ‰ä¸€æ¡æ”¯ä»˜è®°å½•
    UNIQUE KEY uk_user_order (user_id, order_id)
);
```

**ğŸ’» åº”ç”¨å±‚å¹‚ç­‰å¤„ç†**ï¼š
```java
@Service
public class PaymentService {
    
    public PaymentResult processPayment(Long userId, String orderId, BigDecimal amount) {
        try {
            // å°è¯•æ’å…¥æ”¯ä»˜è®°å½•
            PaymentRecord record = new PaymentRecord();
            record.setUserId(userId);
            record.setOrderId(orderId);
            record.setAmount(amount);
            record.setStatus("PROCESSING");
            
            paymentRepository.save(record); // å¦‚æœé‡å¤ä¼šæŠ›å¼‚å¸¸
            
            // æ‰§è¡Œå®é™…æ”¯ä»˜é€»è¾‘
            boolean success = doPayment(userId, amount);
            
            // æ›´æ–°æ”¯ä»˜çŠ¶æ€
            record.setStatus(success ? "SUCCESS" : "FAILED");
            paymentRepository.save(record);
            
            return new PaymentResult(success, "æ”¯ä»˜æˆåŠŸ");
            
        } catch (DataIntegrityViolationException e) {
            // å”¯ä¸€çº¦æŸå†²çªï¼Œè¯´æ˜å·²ç»å¤„ç†è¿‡
            PaymentRecord existing = paymentRepository.findByUserIdAndOrderId(userId, orderId);
            
            if ("SUCCESS".equals(existing.getStatus())) {
                return new PaymentResult(true, "æ”¯ä»˜å·²å®Œæˆ");
            } else {
                return new PaymentResult(false, "æ”¯ä»˜å¤„ç†ä¸­æˆ–å·²å¤±è´¥");
            }
        }
    }
}
```

**ğŸ”§ æ–¹æ³•äºŒï¼šçŠ¶æ€æœºä¿è¯å¹‚ç­‰**ï¼š
```java
@Entity
public class Order {
    public enum OrderStatus {
        CREATED,     // å·²åˆ›å»º
        PAID,        // å·²æ”¯ä»˜  
        SHIPPED,     // å·²å‘è´§
        COMPLETED,   // å·²å®Œæˆ
        CANCELLED    // å·²å–æ¶ˆ
    }
    
    private OrderStatus status;
    private Integer version; // ä¹è§‚é”ç‰ˆæœ¬å·
}

@Service
public class OrderService {
    
    // å¹‚ç­‰çš„è®¢å•æ”¯ä»˜
    @Transactional
    public boolean payOrder(Long orderId) {
        Order order = orderRepository.findById(orderId);
        
        // æ£€æŸ¥å½“å‰çŠ¶æ€ï¼Œåªæœ‰CREATEDçŠ¶æ€æ‰èƒ½æ”¯ä»˜
        if (order.getStatus() != OrderStatus.CREATED) {
            if (order.getStatus() == OrderStatus.PAID) {
                return true; // å·²ç»æ”¯ä»˜è¿‡ï¼Œè¿”å›æˆåŠŸ
            } else {
                throw new IllegalStateException("è®¢å•çŠ¶æ€ä¸å…è®¸æ”¯ä»˜: " + order.getStatus());
            }
        }
        
        // æ‰§è¡Œæ”¯ä»˜é€»è¾‘
        boolean paymentSuccess = paymentService.charge(order.getAmount());
        
        if (paymentSuccess) {
            // ä½¿ç”¨ä¹è§‚é”æ›´æ–°çŠ¶æ€
            int updated = orderRepository.updateStatusWithVersion(
                orderId, OrderStatus.PAID, order.getVersion()
            );
            
            if (updated == 0) {
                // ç‰ˆæœ¬å†²çªï¼Œè¯´æ˜å…¶ä»–çº¿ç¨‹å·²ç»å¤„ç†äº†
                throw new OptimisticLockingFailureException("è®¢å•çŠ¶æ€å·²è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹");
            }
        }
        
        return paymentSuccess;
    }
}
```

### 7.3 å…¨å±€å”¯ä¸€IDå®ç°å¹‚ç­‰


**ğŸ†” åˆ†å¸ƒå¼å”¯ä¸€IDæ–¹æ¡ˆ**ï¼š
```java
@Component
public class IdempotentTokenService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    // ç”Ÿæˆå¹‚ç­‰ä»¤ç‰Œ
    public String generateToken(String userId) {
        String token = userId + "_" + System.currentTimeMillis() + "_" + UUID.randomUUID().toString();
        
        // ä»¤ç‰Œæœ‰æ•ˆæœŸ15åˆ†é’Ÿ
        redisTemplate.opsForValue().set("token:" + token, "valid", 15, TimeUnit.MINUTES);
        
        return token;
    }
    
    // æ¶ˆè´¹å¹‚ç­‰ä»¤ç‰Œï¼ˆåªèƒ½ç”¨ä¸€æ¬¡ï¼‰
    public boolean consumeToken(String token) {
        String key = "token:" + token;
        
        // ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§
        String luaScript = 
            "if redis.call('GET', KEYS[1]) == 'valid' then " +
            "  redis.call('DEL', KEYS[1]) " +
            "  return 1 " +
            "else " +
            "  return 0 " +
            "end";
            
        Long result = redisTemplate.execute(new DefaultRedisScript<>(luaScript, Long.class), 
                                          Collections.singletonList(key));
        
        return result != null && result == 1;
    }
}

@RestController
public class OrderController {
    
    @PostMapping("/orders")
    public ResponseEntity<?> createOrder(@RequestBody OrderRequest request,
                                       @RequestHeader("Idempotent-Token") String token) {
        
        // éªŒè¯å¹¶æ¶ˆè´¹å¹‚ç­‰ä»¤ç‰Œ
        if (!idempotentTokenService.consumeToken(token)) {
            return ResponseEntity.badRequest().body("æ— æ•ˆçš„å¹‚ç­‰ä»¤ç‰Œæˆ–å·²ç»ä½¿ç”¨è¿‡");
        }
        
        // æ‰§è¡Œåˆ›å»ºè®¢å•é€»è¾‘
        Order order = orderService.createOrder(request);
        
        return ResponseEntity.ok(order);
    }
}
```

### 7.4 å¹‚ç­‰æ€§æœ€ä½³å®è·µ


**ğŸ“ è®¾è®¡checklist**ï¼š
- âœ… **ä¸šåŠ¡é”®å”¯ä¸€æ€§**ï¼šä½¿ç”¨ä¸šåŠ¡ç›¸å…³çš„å”¯ä¸€æ ‡è¯†
- âœ… **çŠ¶æ€æœºè®¾è®¡**ï¼šæ˜ç¡®å®šä¹‰çŠ¶æ€è½¬æ¢è§„åˆ™
- âœ… **åŸå­æ“ä½œ**ï¼šä¿è¯æ£€æŸ¥å’Œæ‰§è¡Œçš„åŸå­æ€§
- âœ… **å¼‚å¸¸å¤„ç†**ï¼šé‡å¤è¯·æ±‚è¦è¿”å›ä¸€è‡´çš„ç»“æœ
- âœ… **æ—¥å¿—è®°å½•**ï¼šè®°å½•å¹‚ç­‰æ€§æ£€æŸ¥çš„è¿‡ç¨‹

---

## 8. ğŸ“‰ ä¼˜é›…é™çº§æ¨¡å¼


### 8.1 ä»€ä¹ˆæ˜¯ä¼˜é›…é™çº§


**ğŸ¢ ä¼˜é›…é™çº§**å°±åƒåœç”µæ—¶å•†åœºçš„åº”æ€¥æªæ–½ï¼šè™½ç„¶ç”µæ¢¯åœäº†ï¼Œä½†æ¥¼æ¢¯è¿˜èƒ½ç”¨ï¼›è™½ç„¶ç©ºè°ƒåœäº†ï¼Œä½†è¥ä¸šè¿˜èƒ½ç»§ç»­ã€‚**æ ¸å¿ƒåŠŸèƒ½ä¿æŒå¯ç”¨ï¼Œéæ ¸å¿ƒåŠŸèƒ½ä¸´æ—¶å…³é—­**ã€‚

**ğŸ­ é™çº§ç­–ç•¥å±‚æ¬¡**ï¼š
```
æ­£å¸¸çŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®Œæ•´åŠŸèƒ½ï¼šğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥  â”‚ â† æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸€çº§é™çº§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
â”‚  æ ¸å¿ƒåŠŸèƒ½ï¼šğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥    â”‚ â† å…³é—­æ¨èã€å¹¿å‘Šç­‰
â”‚  (å…³é—­éæ ¸å¿ƒåŠŸèƒ½)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

äºŒçº§é™çº§ï¼š  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸºç¡€åŠŸèƒ½ï¼šğŸ”¥ğŸ”¥        â”‚ â† åªä¿ç•™ç™»å½•ã€æŸ¥çœ‹
â”‚  (åªä¿ç•™å¿…è¦åŠŸèƒ½)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸‰çº§é™çº§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»´æŠ¤é¡µé¢ï¼šğŸ”§            â”‚ â† æ˜¾ç¤ºç»´æŠ¤ä¿¡æ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 MySQLæŸ¥è¯¢é™çº§å®ç°


**ğŸ”§ æ•°æ®æŸ¥è¯¢é™çº§ç­–ç•¥**ï¼š
```java
@Service
public class UserQueryService {
    
    @Autowired
    private DataSource masterDataSource;
    
    @Autowired  
    private DataSource slaveDataSource;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // åˆ†çº§æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    public UserInfo getUserInfo(Long userId) {
        try {
            // Level 1: ä»ç¼“å­˜è·å–å®Œæ•´ä¿¡æ¯
            UserInfo cached = getCachedUserInfo(userId);
            if (cached != null) {
                return cached;
            }
            
            // Level 2: ä»ä»åº“è·å–å®Œæ•´ä¿¡æ¯  
            return getFullUserInfoFromSlave(userId);
            
        } catch (Exception e1) {
            try {
                // Level 3: ä»ä¸»åº“è·å–å®Œæ•´ä¿¡æ¯
                return getFullUserInfoFromMaster(userId);
                
            } catch (Exception e2) {
                try {
                    // Level 4: ä»ç¼“å­˜è·å–åŸºç¡€ä¿¡æ¯
                    return getBasicUserInfoFromCache(userId);
                    
                } catch (Exception e3) {
                    // Level 5: è¿”å›é»˜è®¤ä¿¡æ¯
                    return getDefaultUserInfo(userId);
                }
            }
        }
    }
    
    private UserInfo getFullUserInfoFromSlave(Long userId) throws SQLException {
        try (Connection conn = slaveDataSource.getConnection()) {
            String sql = """
                SELECT u.*, p.avatar, p.nickname, s.level, s.points
                FROM users u 
                LEFT JOIN user_profiles p ON u.id = p.user_id
                LEFT JOIN user_stats s ON u.id = s.user_id  
                WHERE u.id = ?
                """;
            // æ‰§è¡ŒæŸ¥è¯¢...
            return buildFullUserInfo(resultSet);
        }
    }
    
    private UserInfo getBasicUserInfoFromCache(Long userId) {
        // åªè¿”å›åŸºç¡€ä¿¡æ¯ï¼Œå‡å°‘æ•°æ®ä¼ è¾“
        String cacheKey = "user:basic:" + userId;
        UserInfo basic = (UserInfo) redisTemplate.opsForValue().get(cacheKey);
        
        if (basic == null) {
            // æœ€åå°è¯•ä»æ•°æ®åº“è·å–åŸºç¡€ä¿¡æ¯
            basic = getBasicUserInfoFromDB(userId);
        }
        
        return basic;
    }
    
    private UserInfo getDefaultUserInfo(Long userId) {
        // è¿”å›é»˜è®¤ç”¨æˆ·ä¿¡æ¯ï¼Œä¿è¯ç•Œé¢ä¸å‡ºé”™
        UserInfo defaultUser = new UserInfo();
        defaultUser.setId(userId);
        defaultUser.setNickname("ç”¨æˆ·" + userId);
        defaultUser.setAvatar("/default-avatar.png");
        return defaultUser;
    }
}
```

### 8.3 åŠŸèƒ½å¼€å…³æ§åˆ¶é™çº§


**ğŸ›ï¸ åŠŸèƒ½å¼€å…³ç®¡ç†**ï¼š
```java
@Component
public class FeatureToggleService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    // åŠŸèƒ½å¼€å…³é…ç½®
    public enum FeatureFlag {
        RECOMMENDATION_ENGINE("recommendation_engine"),    // æ¨èå¼•æ“
        USER_STATISTICS("user_statistics"),              // ç”¨æˆ·ç»Ÿè®¡
        REAL_TIME_NOTIFICATIONS("real_time_notifications"), // å®æ—¶é€šçŸ¥
        ADVANCED_SEARCH("advanced_search"),              // é«˜çº§æœç´¢
        SOCIAL_FEATURES("social_features");              // ç¤¾äº¤åŠŸèƒ½
        
        private final String key;
        
        FeatureFlag(String key) {
            this.key = key;
        }
    }
    
    // æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¼€å¯
    public boolean isFeatureEnabled(FeatureFlag feature) {
        String value = redisTemplate.opsForValue().get("feature:" + feature.key);
        return "true".equals(value);
    }
    
    // åŠ¨æ€å¼€å¯/å…³é—­åŠŸèƒ½
    public void setFeatureEnabled(FeatureFlag feature, boolean enabled) {
        redisTemplate.opsForValue().set("feature:" + feature.key, String.valueOf(enabled));
        System.out.println("åŠŸèƒ½ " + feature.key + " å·²" + (enabled ? "å¼€å¯" : "å…³é—­"));
    }
}

@RestController
public class HomeController {
    
    @GetMapping("/home")
    public ResponseEntity<HomePageData> getHomePage(@RequestParam Long userId) {
        HomePageData data = new HomePageData();
        
        // åŸºç¡€æ•°æ®ï¼ˆæ€»æ˜¯åŠ è½½ï¼‰
        data.setUserInfo(userService.getBasicUserInfo(userId));
        data.setMainContent(contentService.getMainContent());
        
        // å¯é€‰åŠŸèƒ½ï¼ˆæ ¹æ®å¼€å…³å†³å®šï¼‰
        if (featureToggleService.isFeatureEnabled(FeatureFlag.RECOMMENDATION_ENGINE)) {
            try {
                data.setRecommendations(recommendationService.getRecommendations(userId));
            } catch (Exception e) {
                // æ¨èæœåŠ¡å¤±è´¥ä¸å½±å“ä¸»æµç¨‹
                System.out.println("æ¨èæœåŠ¡å¼‚å¸¸ï¼Œè·³è¿‡æ¨èå†…å®¹");
            }
        }
        
        if (featureToggleService.isFeatureEnabled(FeatureFlag.USER_STATISTICS)) {
            try {
                data.setUserStats(statisticsService.getUserStats(userId));
            } catch (Exception e) {
                // ç»Ÿè®¡æœåŠ¡å¤±è´¥ä¸å½±å“ä¸»æµç¨‹
                System.out.println("ç»Ÿè®¡æœåŠ¡å¼‚å¸¸ï¼Œè·³è¿‡ç»Ÿè®¡ä¿¡æ¯");
            }
        }
        
        return ResponseEntity.ok(data);
    }
}
```

### 8.4 è‡ªåŠ¨é™çº§è§¦å‘å™¨


**ğŸš¨ è‡ªåŠ¨é™çº§ç›‘æ§**ï¼š
```java
@Component
public class AutoDegradationService {
    
    private final AtomicInteger errorCount = new AtomicInteger(0);
    private final long timeWindow = 60000; // 1åˆ†é’Ÿæ—¶é—´çª—å£
    private long windowStartTime = System.currentTimeMillis();
    
    @EventListener
    public void handleDatabaseError(DatabaseErrorEvent event) {
        long currentTime = System.currentTimeMillis();
        
        // é‡ç½®æ—¶é—´çª—å£
        if (currentTime - windowStartTime > timeWindow) {
            errorCount.set(0);
            windowStartTime = currentTime;
        }
        
        int currentErrors = errorCount.incrementAndGet();
        
        // é”™è¯¯ç‡è¶…è¿‡é˜ˆå€¼ï¼Œè§¦å‘è‡ªåŠ¨é™çº§
        if (currentErrors > 10) { // 1åˆ†é’Ÿå†…è¶…è¿‡10ä¸ªé”™è¯¯
            triggerDegradation();
        }
    }
    
    private void triggerDegradation() {
        System.out.println("æ£€æµ‹åˆ°é«˜é”™è¯¯ç‡ï¼Œè‡ªåŠ¨è§¦å‘é™çº§");
        
        // å…³é—­éæ ¸å¿ƒåŠŸèƒ½
        featureToggleService.setFeatureEnabled(FeatureFlag.RECOMMENDATION_ENGINE, false);
        featureToggleService.setFeatureEnabled(FeatureFlag.USER_STATISTICS, false);
        featureToggleService.setFeatureEnabled(FeatureFlag.ADVANCED_SEARCH, false);
        
        // å‘é€å‘Šè­¦é€šçŸ¥
        alertService.sendAlert("ç³»ç»Ÿå·²è‡ªåŠ¨é™çº§ï¼Œå…³é—­éæ ¸å¿ƒåŠŸèƒ½");
        
        // 5åˆ†é’Ÿåå°è¯•æ¢å¤
        scheduledExecutorService.schedule(this::attemptRecovery, 5, TimeUnit.MINUTES);
    }
    
    private void attemptRecovery() {
        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        if (healthCheckService.isSystemHealthy()) {
            // é€æ­¥æ¢å¤åŠŸèƒ½
            recoverFeatures();
        } else {
            // å»¶é•¿é™çº§æ—¶é—´
            scheduledExecutorService.schedule(this::attemptRecovery, 5, TimeUnit.MINUTES);
        }
    }
}
```

**ğŸ’¡ é™çº§è®¾è®¡åŸåˆ™**ï¼š
- **åˆ†çº§é™çº§**ï¼šæŒ‰é‡è¦ç¨‹åº¦åˆ†çº§ï¼Œé€æ­¥é™çº§
- **å¿«é€Ÿæ¢å¤**ï¼šç›‘æ§ç³»ç»ŸçŠ¶æ€ï¼Œè‡ªåŠ¨æ¢å¤åŠŸèƒ½
- **ç”¨æˆ·æ„ŸçŸ¥æœ€å°åŒ–**ï¼šå°½é‡ä¸å½±å“ç”¨æˆ·æ ¸å¿ƒä½“éªŒ
- **ç›‘æ§å‘Šè­¦**ï¼šé™çº§æ“ä½œè¦æœ‰å®Œå–„çš„ç›‘æ§

---

## 9. âš¡ æ•…éšœå¿«é€Ÿæ¢å¤æ¨¡å¼


### 9.1 ä»€ä¹ˆæ˜¯æ•…éšœå¿«é€Ÿæ¢å¤


**ğŸ¥ æ•…éšœå¿«é€Ÿæ¢å¤**å°±åƒåŒ»é™¢çš„æ€¥æ•‘æµç¨‹ï¼š**å¿«é€Ÿè¯Šæ–­é—®é¢˜ â†’ ç«‹å³é‡‡å–è¡ŒåŠ¨ â†’ æ¢å¤æ­£å¸¸çŠ¶æ€**ã€‚ç›®æ ‡æ˜¯å°†æ•…éšœå½±å“æ—¶é—´é™åˆ°æœ€ä½ã€‚

**â±ï¸ æ¢å¤æ—¶é—´ç›®æ ‡ï¼ˆRTOï¼‰vs æ¢å¤ç‚¹ç›®æ ‡ï¼ˆRPOï¼‰**ï¼š
```
æ—¶é—´è½´ç¤ºä¾‹ï¼š
æ•…éšœå‘ç”Ÿ        æ£€æµ‹åˆ°æ•…éšœ      å¼€å§‹æ¢å¤        å®Œå…¨æ¢å¤
    |              |             |              |
    |â†â”€â”€ æ£€æµ‹æ—¶é—´ â”€â”€â†’|â†â”€â”€ æ¢å¤æ—¶é—´ â”€â”€â†’|
    |â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RTO (æ€»æ¢å¤æ—¶é—´) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’|
    
æ•°æ®ä¸¢å¤±ï¼š
    |â†â”€â”€ RPO (æœ€å¤§å¯æ¥å—æ•°æ®ä¸¢å¤±æ—¶é—´) â”€â”€â†’|
```

### 9.2 MySQLä¸»ä»å¿«é€Ÿåˆ‡æ¢


**ğŸ”„ è‡ªåŠ¨æ•…éšœåˆ‡æ¢å®ç°**ï¼š
```java
@Component
public class DatabaseFailoverManager {
    
    @Autowired
    private DataSource masterDataSource;
    
    @Autowired
    private List<DataSource> slaveDataSources;
    
    @Autowired  
    private HealthCheckService healthCheckService;
    
    private volatile DataSource currentWriteDataSource;
    private volatile List<DataSource> currentReadDataSources;
    
    @PostConstruct
    public void initialize() {
        currentWriteDataSource = masterDataSource;
        currentReadDataSources = new ArrayList<>(slaveDataSources);
        
        // å¯åŠ¨å¥åº·æ£€æŸ¥
        startHealthCheck();
    }
    
    // å®šæœŸå¥åº·æ£€æŸ¥
    @Scheduled(fixedRate = 5000) // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
    public void startHealthCheck() {
        // æ£€æŸ¥ä¸»åº“å¥åº·çŠ¶æ€
        if (!healthCheckService.isHealthy(masterDataSource)) {
            handleMasterFailure();
        }
        
        // æ£€æŸ¥ä»åº“å¥åº·çŠ¶æ€
        checkSlaveHealth();
    }
    
    private void handleMasterFailure() {
        System.out.println("æ£€æµ‹åˆ°ä¸»åº“æ•…éšœï¼Œå¼€å§‹æ•…éšœåˆ‡æ¢...");
        
        try {
            // 1. åœæ­¢å†™å…¥æ“ä½œ
            stopWriteOperations();
            
            // 2. é€‰æ‹©æœ€ä½³ä»åº“ä½œä¸ºæ–°ä¸»åº“
            DataSource newMaster = selectBestSlave();
            
            if (newMaster != null) {
                // 3. æå‡ä»åº“ä¸ºä¸»åº“
                promoteSlaveToMaster(newMaster);
                
                // 4. æ›´æ–°åº”ç”¨é…ç½®
                updateDataSourceRouting(newMaster);
                
                // 5. æ¢å¤å†™å…¥æ“ä½œ
                resumeWriteOperations();
                
                System.out.println("æ•…éšœåˆ‡æ¢å®Œæˆï¼Œæ–°ä¸»åº“å·²ç”Ÿæ•ˆ");
                
            } else {
                // æ²¡æœ‰å¯ç”¨ä»åº“ï¼Œè¿›å…¥åªè¯»æ¨¡å¼
                enableReadOnlyMode();
            }
            
        } catch (Exception e) {
            System.err.println("æ•…éšœåˆ‡æ¢å¤±è´¥: " + e.getMessage());
            enableEmergencyMode();
        }
    }
    
    private DataSource selectBestSlave() {
        DataSource bestSlave = null;
        long maxBinlogPosition = -1;
        
        for (DataSource slave : slaveDataSources) {
            if (healthCheckService.isHealthy(slave)) {
                // é€‰æ‹©binlogä½ç½®æœ€æ–°çš„ä»åº“
                long binlogPosition = getBinlogPosition(slave);
                if (binlogPosition > maxBinlogPosition) {
                    maxBinlogPosition = binlogPosition;
                    bestSlave = slave;
                }
            }
        }
        
        return bestSlave;
    }
    
    private void promoteSlaveToMaster(DataSource newMaster) throws SQLException {
        try (Connection conn = newMaster.getConnection()) {
            // åœæ­¢å¤åˆ¶
            conn.createStatement().execute("STOP SLAVE");
            
            // é‡ç½®ä»åº“çŠ¶æ€
            conn.createStatement().execute("RESET SLAVE ALL");
            
            // è®¾ç½®ä¸ºå¯å†™
            conn.createStatement().execute("SET GLOBAL read_only = OFF");
            
            System.out.println("ä»åº“å·²æå‡ä¸ºä¸»åº“");
        }
    }
}
```

### 9.3 è¿æ¥æ± å¿«é€Ÿæ¢å¤


**ğŸŠ è¿æ¥æ± æ•…éšœæ¢å¤**ï¼š
```java
@Component
public class SmartConnectionPool {
    
    private final Map<String, HikariDataSource> dataSources = new ConcurrentHashMap<>();
    private final Map<String, Boolean> dataSourceHealth = new ConcurrentHashMap<>();
    
    public Connection getConnection(String dataSourceName) throws SQLException {
        HikariDataSource dataSource = dataSources.get(dataSourceName);
        
        // æ£€æŸ¥æ•°æ®æºå¥åº·çŠ¶æ€
        if (!isDataSourceHealthy(dataSourceName)) {
            // å°è¯•é‡æ–°åˆå§‹åŒ–
            if (attemptReconnection(dataSourceName)) {
                System.out.println("æ•°æ®æº " + dataSourceName + " é‡è¿æˆåŠŸ");
            } else {
                throw new SQLException("æ•°æ®æºä¸å¯ç”¨: " + dataSourceName);
            }
        }
        
        try {
            return dataSource.getConnection();
        } catch (SQLException e) {
            // è·å–è¿æ¥å¤±è´¥ï¼Œæ ‡è®°æ•°æ®æºä¸ºä¸å¥åº·
            markDataSourceUnhealthy(dataSourceName);
            throw e;
        }
    }
    
    private boolean attemptReconnection(String dataSourceName) {
        try {
            HikariDataSource oldDataSource = dataSources.get(dataSourceName);
            
            // åˆ›å»ºæ–°çš„è¿æ¥æ± 
            HikariConfig config = new HikariConfig();
            config.setJdbcUrl(oldDataSource.getJdbcUrl());
            config.setUsername(oldDataSource.getUsername());
            config.setPassword(oldDataSource.getPassword());
            config.setMaximumPoolSize(10);
            config.setConnectionTimeout(5000);
            config.setValidationTimeout(3000);
            
            HikariDataSource newDataSource = new HikariDataSource(config);
            
            // æµ‹è¯•è¿æ¥
            try (Connection testConn = newDataSource.getConnection()) {
                testConn.createStatement().execute("SELECT 1");
            }
            
            // æ›¿æ¢æ—§è¿æ¥æ± 
            HikariDataSource old = dataSources.put(dataSourceName, newDataSource);
            if (old != null && !old.isClosed()) {
                old.close(); // å…³é—­æ—§è¿æ¥æ± 
            }
            
            markDataSourceHealthy(dataSourceName);
            return true;
            
        } catch (Exception e) {
            System.err.println("é‡è¿å¤±è´¥: " + e.getMessage());
            return false;
        }
    }
    
    // åå°å¥åº·æ£€æŸ¥ä»»åŠ¡
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void performHealthCheck() {
        for (String dataSourceName : dataSources.keySet()) {
            if (!isDataSourceHealthy(dataSourceName)) {
                // å°è¯•æ¢å¤ä¸å¥åº·çš„æ•°æ®æº
                attemptReconnection(dataSourceName);
            }
        }
    }
}
```

### 9.4 æ•°æ®ä¸€è‡´æ€§å¿«é€Ÿä¿®å¤


**ğŸ”§ æ•°æ®åŒæ­¥ä¿®å¤**ï¼š
```java
@Service
public class DataConsistencyRepairer {
    
    // æ£€æµ‹å¹¶ä¿®å¤ä¸»ä»æ•°æ®ä¸ä¸€è‡´
    public void repairMasterSlaveInconsistency() {
        System.out.println("å¼€å§‹æ£€æµ‹ä¸»ä»æ•°æ®ä¸€è‡´æ€§...");
        
        try {
            // 1. æ¯”è¾ƒä¸»ä»æ•°æ®
            List<DataInconsistency> inconsistencies = detectInconsistencies();
            
            if (inconsistencies.isEmpty()) {
                System.out.println("ä¸»ä»æ•°æ®ä¸€è‡´ï¼Œæ— éœ€ä¿®å¤");
                return;
            }
            
            // 2. ä¿®å¤æ•°æ®ä¸ä¸€è‡´
            for (DataInconsistency inconsistency : inconsistencies) {
                repairInconsistency(inconsistency);
            }
            
            System.out.println("æ•°æ®ä¸€è‡´æ€§ä¿®å¤å®Œæˆ");
            
        } catch (Exception e) {
            System.err.println("æ•°æ®ä¸€è‡´æ€§ä¿®å¤å¤±è´¥: " + e.getMessage());
        }
    }
    
    private List<DataInconsistency> detectInconsistencies() throws SQLException {
        List<DataInconsistency> inconsistencies = new ArrayList<>();
        
        // æ¯”è¾ƒå…³é”®è¡¨çš„checksum
        String[] criticalTables = {"users", "orders", "payments"};
        
        for (String tableName : criticalTables) {
            String masterChecksum = calculateChecksum(masterDataSource, tableName);
            String slaveChecksum = calculateChecksum(slaveDataSource, tableName);
            
            if (!masterChecksum.equals(slaveChecksum)) {
                inconsistencies.add(new DataInconsistency(tableName, masterChecksum, slaveChecksum));
                System.out.println("å‘ç°æ•°æ®ä¸ä¸€è‡´: " + tableName);
            }
        }
        
        return inconsistencies;
    }
    
    private String calculateChecksum(DataSource dataSource, String tableName) throws SQLException {
        try (Connection conn = dataSource.getConnection()) {
            String sql = "CHECKSUM TABLE " + tableName;
            ResultSet rs = conn.createStatement().executeQuery(sql);
            if (rs.next()) {
                return rs.getString("Checksum");
            }
            return "";
        }
    }
    
    private void repairInconsistency(DataInconsistency inconsistency) throws SQLException {
        String tableName = inconsistency.getTableName();
        
        System.out.println("ä¿®å¤è¡¨ " + tableName + " çš„æ•°æ®ä¸ä¸€è‡´");
        
        // æ–¹æ¡ˆ1: é‡æ–°åŒæ­¥æ•´ä¸ªè¡¨
        if (isSmallTable(tableName)) {
            rebuildTableData(tableName);
        } 
        // æ–¹æ¡ˆ2: å¢é‡ä¿®å¤
        else {
            incrementalRepair(tableName);
        }
    }
    
    private void rebuildTableData(String tableName) throws SQLException {
        // ä»ä¸»åº“é‡æ–°å¯¼å‡ºæ•°æ®åˆ°ä»åº“
        System.out.println("é‡å»ºè¡¨ " + tableName + " æ•°æ®");
        
        try (Connection masterConn = masterDataSource.getConnection();
             Connection slaveConn = slaveDataSource.getConnection()) {
            
            // æš‚åœå¤åˆ¶
            slaveConn.createStatement().execute("STOP SLAVE");
            
            // æ¸…ç©ºä»åº“è¡¨æ•°æ®
            slaveConn.createStatement().execute("DELETE FROM " + tableName);
            
            // ä»ä¸»åº“å¤åˆ¶æ•°æ®
            String selectSql = "SELECT * FROM " + tableName;
            PreparedStatement selectStmt = masterConn.prepareStatement(selectSql);
            ResultSet rs = selectStmt.executeQuery();
            
            // æ„å»ºæ’å…¥è¯­å¥
            ResultSetMetaData metaData = rs.getMetaData();
            int columnCount = metaData.getColumnCount();
            
            StringBuilder insertSql = new StringBuilder("INSERT INTO " + tableName + " VALUES (");
            for (int i = 1; i <= columnCount; i++) {
                insertSql.append("?");
                if (i < columnCount) insertSql.append(",");
            }
            insertSql.append(")");
            
            PreparedStatement insertStmt = slaveConn.prepareStatement(insertSql.toString());
            
            // æ‰¹é‡æ’å…¥æ•°æ®
            while (rs.next()) {
                for (int i = 1; i <= columnCount; i++) {
                    insertStmt.setObject(i, rs.getObject(i));
                }
                insertStmt.addBatch();
            }
            
            insertStmt.executeBatch();
            
            // æ¢å¤å¤åˆ¶
            slaveConn.createStatement().execute("START SLAVE");
            
            System.out.println("è¡¨ " + tableName + " æ•°æ®é‡å»ºå®Œæˆ");
        }
    }
}
```

### 9.5 åº”ç”¨å±‚å¿«é€Ÿæ¢å¤


**âš¡ åº”ç”¨é‡å¯ä¼˜åŒ–**ï¼š
```java
@Component
public class FastRecoveryService {
    
    @Autowired
    private ApplicationContext applicationContext;
    
    // åº”ç”¨å¿«é€Ÿé‡å¯
    public void performFastRestart() {
        System.out.println("å¼€å§‹æ‰§è¡Œå¿«é€Ÿæ¢å¤...");
        
        try {
            // 1. ä¿å­˜å…³é”®çŠ¶æ€
            saveApplicationState();
            
            // 2. æ¸…ç†èµ„æº
            cleanupResources();
            
            // 3. é‡æ–°åˆå§‹åŒ–å…³é”®ç»„ä»¶
            reinitializeCriticalComponents();
            
            // 4. æ¢å¤åº”ç”¨çŠ¶æ€
            restoreApplicationState();
            
            System.out.println("å¿«é€Ÿæ¢å¤å®Œæˆ");
            
        } catch (Exception e) {
            System.err.println("å¿«é€Ÿæ¢å¤å¤±è´¥: " + e.getMessage());
            // è§¦å‘å®Œæ•´é‡å¯
            triggerFullRestart();
        }
    }
    
    private void saveApplicationState() {
        // ä¿å­˜è¿æ¥æ± çŠ¶æ€
        Map<String, Object> connectionPoolState = new HashMap<>();
        // ä¿å­˜ç¼“å­˜çŠ¶æ€
        Map<String, Object> cacheState = new HashMap<>();
        // ä¿å­˜ç”¨æˆ·ä¼šè¯çŠ¶æ€
        Map<String, Object> sessionState = new HashMap<>();
        
        // æŒä¹…åŒ–åˆ°Redisæˆ–æ–‡ä»¶
        redisTemplate.opsForValue().set("app:state:connections", connectionPoolState);
        redisTemplate.opsForValue().set("app:state:cache", cacheState);
        redisTemplate.opsForValue().set("app:state:sessions", sessionState);
    }
    
    private void reinitializeCriticalComponents() {
        // é‡æ–°åˆå§‹åŒ–æ•°æ®æº
        reinitializeDataSources();
        
        // é‡æ–°åˆå§‹åŒ–ç¼“å­˜
        reinitializeCache();
        
        // é‡æ–°åˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—
        reinitializeMessageQueue();
    }
    
    private void reinitializeDataSources() {
        System.out.println("é‡æ–°åˆå§‹åŒ–æ•°æ®æº...");
        
        // å…³é—­æ‰€æœ‰ç°æœ‰è¿æ¥
        Collection<DataSource> dataSources = applicationContext.getBeansOfType(DataSource.class).values();
        for (DataSource ds : dataSources) {
            if (ds instanceof HikariDataSource) {
                ((HikariDataSource) ds).close();
            }
        }
        
        // é‡æ–°åˆ›å»ºè¿æ¥æ± 
        // å®ç°ç»†èŠ‚...
    }
}
```

### 9.6 ç›‘æ§ä¸å‘Šè­¦


**ğŸ“Š æ•…éšœæ¢å¤ç›‘æ§é¢æ¿**ï¼š
```java
@RestController
@RequestMapping("/api/monitoring")
public class MonitoringController {
    
    @GetMapping("/health")
    public ResponseEntity<HealthStatus> getSystemHealth() {
        HealthStatus status = new HealthStatus();
        
        // æ•°æ®åº“å¥åº·çŠ¶æ€
        status.setDatabaseHealth(checkDatabaseHealth());
        
        // è¿æ¥æ± çŠ¶æ€
        status.setConnectionPoolHealth(checkConnectionPoolHealth());
        
        // åº”ç”¨å¥åº·çŠ¶æ€
        status.setApplicationHealth(checkApplicationHealth());
        
        // æ¢å¤æ—¶é—´ç»Ÿè®¡
        status.setRecoveryMetrics(getRecoveryMetrics());
        
        return ResponseEntity.ok(status);
    }
    
    private DatabaseHealth checkDatabaseHealth() {
        DatabaseHealth health = new DatabaseHealth();
        
        // æ£€æŸ¥ä¸»åº“
        health.setMasterStatus(healthCheckService.isHealthy(masterDataSource) ? "UP" : "DOWN");
        
        // æ£€æŸ¥ä»åº“
        List<String> slaveStatuses = new ArrayList<>();
        for (DataSource slave : slaveDataSources) {
            slaveStatuses.add(healthCheckService.isHealthy(slave) ? "UP" : "DOWN");
        }
        health.setSlaveStatuses(slaveStatuses);
        
        // æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
        health.setReplicationLag(measureReplicationLag());
        
        return health;
    }
    
    private RecoveryMetrics getRecoveryMetrics() {
        RecoveryMetrics metrics = new RecoveryMetrics();
        
        // å¹³å‡æ•…éšœæ£€æµ‹æ—¶é—´
        metrics.setAvgDetectionTime(calculateAverageDetectionTime());
        
        // å¹³å‡æ¢å¤æ—¶é—´
        metrics.setAvgRecoveryTime(calculateAverageRecoveryTime());
        
        // æ•…éšœé¢‘ç‡
        metrics.setFailureFrequency(calculateFailureFrequency());
        
        // å¯ç”¨æ€§ç™¾åˆ†æ¯”
        metrics.setAvailabilityPercentage(calculateAvailability());
        
        return metrics;
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ å®¹é”™è®¾è®¡æ¨¡å¼æ€»è§ˆ**ï¼š

| æ¨¡å¼ | **æ ¸å¿ƒæ€æƒ³** | **ä¸»è¦ä½œç”¨** | **MySQLåº”ç”¨åœºæ™¯** |
|------|-------------|-------------|------------------|
| **â° è¶…æ—¶é‡è¯•** | `å¤±è´¥åç­‰å¾…é‡è¯•` | `å¤„ç†ä¸´æ—¶æ•…éšœ` | `è¿æ¥è¶…æ—¶ã€æ­»é”é‡è¯•` |
| **ğŸ”Œ æ–­è·¯å™¨** | `å¿«é€Ÿå¤±è´¥ä¿æŠ¤` | `é˜²æ­¢çº§è”æ•…éšœ` | `ä¸»ä»åˆ‡æ¢ä¿æŠ¤` |
| **ğŸš¢ èˆ±å£éš”ç¦»** | `èµ„æºç‹¬ç«‹éš”ç¦»` | `æ•…éšœå½±å“éš”ç¦»` | `è¿æ¥æ± æŒ‰ä¸šåŠ¡éš”ç¦»` |
| **ğŸ”„ å¼‚æ­¥å¤„ç†** | `éé˜»å¡å¤„ç†` | `æå‡å“åº”é€Ÿåº¦` | `å¼‚æ­¥å†™å…¥ã€è¯»å†™åˆ†ç¦»` |
| **ğŸ’° è¡¥å¿äº‹åŠ¡** | `å¤±è´¥åæ’¤é”€` | `ä¿è¯æœ€ç»ˆä¸€è‡´æ€§` | `åˆ†å¸ƒå¼äº‹åŠ¡è¡¥å¿` |
| **ğŸ”‘ å¹‚ç­‰æ€§** | `é‡å¤æ‰§è¡Œå®‰å…¨` | `æ”¯æŒå®‰å…¨é‡è¯•` | `é˜²æ­¢é‡å¤æäº¤` |
| **ğŸ“‰ ä¼˜é›…é™çº§** | `æ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆ` | `ä¿è¯åŸºæœ¬å¯ç”¨` | `åŠŸèƒ½å¼€å…³æ§åˆ¶` |
| **âš¡ å¿«é€Ÿæ¢å¤** | `æœ€å°åŒ–æ•…éšœæ—¶é—´` | `å¿«é€Ÿæ¢å¤æœåŠ¡` | `ä¸»ä»è‡ªåŠ¨åˆ‡æ¢` |

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®¹é”™ä¸æ˜¯é“¶å¼¹**ï¼š
```
å®¹é”™è®¾è®¡çš„æƒè¡¡ï¼š
âœ… æé«˜ç³»ç»Ÿå¯ç”¨æ€§
âœ… å‡å°‘æ•…éšœå½±å“
âŒ å¢åŠ ç³»ç»Ÿå¤æ‚æ€§
âŒ å¢åŠ å¼€å‘æˆæœ¬
âŒ å¯èƒ½å½±å“æ€§èƒ½

é€‰æ‹©åŸåˆ™ï¼š
â€¢ æ ¹æ®ä¸šåŠ¡é‡è¦æ€§å†³å®šå®¹é”™çº§åˆ«
â€¢ ä¼˜å…ˆä¿è¯æ ¸å¿ƒåŠŸèƒ½çš„å®¹é”™
â€¢ åœ¨æˆæœ¬å’Œæ”¶ç›Šä¹‹é—´æ‰¾å¹³è¡¡
```

**ğŸ”¹ ç›‘æ§æ˜¯å®¹é”™çš„çœ¼ç›**ï¼š
```
æ²¡æœ‰ç›‘æ§çš„å®¹é”™ = ç›²äººèµ°è·¯

å¿…é¡»ç›‘æ§çš„æŒ‡æ ‡ï¼š
â€¢ æ•…éšœæ£€æµ‹æ—¶é—´
â€¢ æ¢å¤æˆåŠŸç‡  
â€¢ ç³»ç»Ÿå¯ç”¨æ€§
â€¢ ç”¨æˆ·å½±å“ç¨‹åº¦

å‘Šè­¦é€šçŸ¥ï¼š
â€¢ æ•…éšœå‘ç”Ÿç«‹å³é€šçŸ¥
â€¢ æ¢å¤è¿‡ç¨‹å®æ—¶æ›´æ–°
â€¢ äº‹åæ€»ç»“åˆ†ææŠ¥å‘Š
```

**ğŸ”¹ æµ‹è¯•æ˜¯å®¹é”™çš„ä¿è¯**ï¼š
```
å®¹é”™æµ‹è¯•æ–¹æ³•ï¼š
â€¢ æ··æ²Œå·¥ç¨‹ï¼šæ•…æ„åˆ¶é€ æ•…éšœ
â€¢ æ•…éšœæ³¨å…¥ï¼šæ¨¡æ‹Ÿå„ç§å¼‚å¸¸
â€¢ å‹åŠ›æµ‹è¯•ï¼šéªŒè¯æé™æƒ…å†µ
â€¢ æ¢å¤æ¼”ç»ƒï¼šæµ‹è¯•æ¢å¤æµç¨‹

æµ‹è¯•è¦ç‚¹ï¼š
â€¢ æµ‹è¯•æ‰€æœ‰æ•…éšœåœºæ™¯
â€¢ éªŒè¯æ¢å¤æ—¶é—´ç›®æ ‡
â€¢ æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
â€¢ ç¡®ä¿ç”¨æˆ·ä½“éªŒ
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“‹ å®¹é”™è®¾è®¡checklist**ï¼š

**âš™ï¸ è®¾è®¡é˜¶æ®µ**ï¼š
- âœ… è¯†åˆ«æ‰€æœ‰å¯èƒ½çš„æ•…éšœç‚¹
- âœ… ç¡®å®šå„åŠŸèƒ½çš„é‡è¦æ€§ç­‰çº§
- âœ… é€‰æ‹©åˆé€‚çš„å®¹é”™æ¨¡å¼
- âœ… è®¾è®¡ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

**ğŸ’» å¼€å‘é˜¶æ®µ**ï¼š
- âœ… å®ç°è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- âœ… æ·»åŠ æ–­è·¯å™¨ä¿æŠ¤
- âœ… å®ç°å¹‚ç­‰æ€§æ£€æŸ¥
- âœ… æ·»åŠ é™çº§å¼€å…³

**ğŸ§ª æµ‹è¯•é˜¶æ®µ**ï¼š
- âœ… æ•…éšœåœºæ™¯æµ‹è¯•
- âœ… æ¢å¤æ—¶é—´éªŒè¯
- âœ… æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
- âœ… ç”¨æˆ·ä½“éªŒæµ‹è¯•

**ğŸš€ è¿ç»´é˜¶æ®µ**ï¼š
- âœ… å®æ—¶ç›‘æ§å‘Šè­¦
- âœ… å®šæœŸæ•…éšœæ¼”ç»ƒ
- âœ… å®¹é”™å‚æ•°è°ƒä¼˜
- âœ… äº‹æ•…å¤ç›˜æ”¹è¿›

### 10.4 æœ€ä½³å®è·µæ€»ç»“


**ğŸ’¡ è®¾è®¡åŸåˆ™**ï¼š
```
ğŸ¯ å¤±è´¥æ˜¯å¸¸æ€ï¼šè®¾è®¡æ—¶å‡è®¾ä¸€åˆ‡éƒ½ä¼šå¤±è´¥
âš¡ å¿«é€Ÿå¤±è´¥ï¼šå°½æ—©å‘ç°å¹¶å¤„ç†é—®é¢˜
ğŸ”„ è‡ªåŠ¨æ¢å¤ï¼šå‡å°‘äººå·¥å¹²é¢„
ğŸ“Š å…¨é¢ç›‘æ§ï¼šé‡åŒ–æ‰€æœ‰é‡è¦æŒ‡æ ‡
ğŸ§ª æŒç»­æ”¹è¿›ï¼šæ ¹æ®å®é™…æƒ…å†µä¸æ–­ä¼˜åŒ–
```

**âš ï¸ å¸¸è§é™·é˜±**ï¼š
```
è¿‡åº¦è®¾è®¡ï¼š
â€¢ ä¸ºä¸é‡è¦çš„åŠŸèƒ½å¢åŠ å¤æ‚çš„å®¹é”™æœºåˆ¶
â€¢ å®¹é”™å±‚çº§è¿‡å¤šå¯¼è‡´ç³»ç»Ÿå¤æ‚åº¦çˆ†ç‚¸

ç›‘æ§ç¼ºå¤±ï¼š
â€¢ åªå…³æ³¨æŠ€æœ¯æŒ‡æ ‡ï¼Œå¿½ç•¥ä¸šåŠ¡æŒ‡æ ‡
â€¢ å‘Šè­¦é˜ˆå€¼è®¾ç½®ä¸åˆç†

æµ‹è¯•ä¸è¶³ï¼š
â€¢ åªåœ¨æ­£å¸¸æƒ…å†µä¸‹æµ‹è¯•
â€¢ æ²¡æœ‰éªŒè¯æç«¯åœºæ™¯

ç»´æŠ¤å›°éš¾ï¼š
â€¢ å®¹é”™æœºåˆ¶ç¼ºä¹æ–‡æ¡£
â€¢ å‚æ•°é…ç½®åˆ†æ•£éš¾ä»¥ç®¡ç†
```

**ğŸ“ å­¦ä¹ å»ºè®®**ï¼š
1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆå®ç°è¶…æ—¶é‡è¯•ï¼Œå†é€æ­¥åŠ å…¥å…¶ä»–æ¨¡å¼
2. **ç»“åˆå®é™…**ï¼šæ ¹æ®è‡ªå·±ç³»ç»Ÿçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å®¹é”™æ¨¡å¼
3. **æŒç»­å­¦ä¹ **ï¼šå…³æ³¨ä¸šç•Œæœ€æ–°çš„å®¹é”™å®è·µå’Œå·¥å…·
4. **ç»éªŒç§¯ç´¯**ï¼šé€šè¿‡æ•…éšœæ¼”ç»ƒç§¯ç´¯å®æˆ˜ç»éªŒ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å®¹é”™è®¾è®¡å…«æ¨¡å¼ï¼Œæ•…éšœé¢å‰ä¸æ…Œå¼ 
- ç›‘æ§å‘Šè­¦æ˜¯çœ¼ç›ï¼Œå¿«é€Ÿæ¢å¤æ˜¯æ‰‹è„š  
- æµ‹è¯•æ¼”ç»ƒå‹¤ç»ƒå…µï¼Œä¸´é˜µä¸ä¹±ä¿å¹³å®‰
- æƒè¡¡æˆæœ¬æ‰¾å¹³è¡¡ï¼Œæ ¸å¿ƒåŠŸèƒ½è¦ä¼˜å…ˆ