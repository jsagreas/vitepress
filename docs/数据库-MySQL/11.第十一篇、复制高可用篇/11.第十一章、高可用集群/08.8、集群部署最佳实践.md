---
title: 8ã€é›†ç¾¤éƒ¨ç½²æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [MySQLé›†ç¾¤éƒ¨ç½²æ¦‚è¿°](#1-MySQLé›†ç¾¤éƒ¨ç½²æ¦‚è¿°)
2. [éƒ¨ç½²è§„åˆ’ç­–ç•¥](#2-éƒ¨ç½²è§„åˆ’ç­–ç•¥)
3. [ç¯å¢ƒå‡†å¤‡æ¸…å•](#3-ç¯å¢ƒå‡†å¤‡æ¸…å•)
4. [éƒ¨ç½²æµç¨‹æ ‡å‡†åŒ–](#4-éƒ¨ç½²æµç¨‹æ ‡å‡†åŒ–)
5. [é…ç½®æ¨¡æ¿ç®¡ç†](#5-é…ç½®æ¨¡æ¿ç®¡ç†)
6. [éƒ¨ç½²éªŒè¯æµ‹è¯•](#6-éƒ¨ç½²éªŒè¯æµ‹è¯•)
7. [éƒ¨ç½²å›æ»šæ–¹æ¡ˆ](#7-éƒ¨ç½²å›æ»šæ–¹æ¡ˆ)
8. [è“ç»¿éƒ¨ç½²ä¸ç°åº¦ç­–ç•¥](#8-è“ç»¿éƒ¨ç½²ä¸ç°åº¦ç­–ç•¥)
9. [å®¹å™¨åŒ–é›†ç¾¤éƒ¨ç½²](#9-å®¹å™¨åŒ–é›†ç¾¤éƒ¨ç½²)
10. [éƒ¨ç½²é£é™©è¯„ä¼°ä¸æ§åˆ¶](#10-éƒ¨ç½²é£é™©è¯„ä¼°ä¸æ§åˆ¶)
11. [éƒ¨ç½²è‡ªåŠ¨åŒ–å·¥å…·](#11-éƒ¨ç½²è‡ªåŠ¨åŒ–å·¥å…·)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ MySQLé›†ç¾¤éƒ¨ç½²æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯MySQLé›†ç¾¤éƒ¨ç½²


**ğŸ“‹ æ ¸å¿ƒå®šä¹‰**
MySQLé›†ç¾¤éƒ¨ç½²æ˜¯æŒ‡å°†å¤šä¸ªMySQLå®ä¾‹ç»„æˆä¸€ä¸ªé«˜å¯ç”¨ã€é«˜æ€§èƒ½çš„æ•°æ®åº“ç³»ç»Ÿã€‚ç®€å•è¯´ï¼Œå°±æ˜¯æŠŠå¤šå°MySQLæœåŠ¡å™¨ç»„åˆåœ¨ä¸€èµ·ï¼Œè®©å®ƒä»¬ååŒå·¥ä½œï¼Œæä¾›æ¯”å•å°æœåŠ¡å™¨æ›´å¼ºçš„æœåŠ¡èƒ½åŠ›ã€‚

**ğŸ” ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤éƒ¨ç½²**
```
å•æœºMySQLçš„é—®é¢˜ï¼š
- ç¡¬ä»¶æ•…éšœ â†’ æ•´ä¸ªæœåŠ¡åœæ­¢
- æ€§èƒ½ç“¶é¢ˆ â†’ æ— æ³•åº”å¯¹é«˜å¹¶å‘
- æ•°æ®ä¸¢å¤± â†’ æ²¡æœ‰å¤‡ä»½ä¿éšœ

é›†ç¾¤çš„è§£å†³æ–¹æ¡ˆï¼š
- å¤šæœºå¤‡ä»½ â†’ ä¸€å°åäº†å…¶ä»–ç»§ç»­å·¥ä½œ
- è´Ÿè½½åˆ†æ•£ â†’ å¤šå°æœºå™¨åˆ†æ‹…å‹åŠ›
- æ•°æ®å†—ä½™ â†’ å¤šä»½æ•°æ®ä¿è¯å®‰å…¨
```

### 1.2 é›†ç¾¤éƒ¨ç½²çš„æ ¸å¿ƒç›®æ ‡


**ğŸ¯ ä¸»è¦ç›®æ ‡**
- **é«˜å¯ç”¨æ€§**ï¼šæœåŠ¡å™¨å®•æœºä¸å½±å“ä¸šåŠ¡
- **é«˜æ€§èƒ½**ï¼šå¤šå°æœåŠ¡å™¨æä¾›æ›´å¼ºå¤„ç†èƒ½åŠ›
- **æ•°æ®å®‰å…¨**ï¼šå¤šä»½æ•°æ®å‰¯æœ¬é˜²æ­¢ä¸¢å¤±
- **å¯æ‰©å±•æ€§**ï¼šä¸šåŠ¡å¢é•¿æ—¶å¯ä»¥æ–¹ä¾¿å¢åŠ æœåŠ¡å™¨

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
```
ç”µå•†ç½‘ç«™ï¼š
- è®¢å•ç³»ç»Ÿä¸èƒ½åœæœº
- ä¿ƒé”€æœŸé—´è®¿é—®é‡æ¿€å¢
- ç”¨æˆ·æ•°æ®ç»å¯¹ä¸èƒ½ä¸¢å¤±

é“¶è¡Œç³»ç»Ÿï¼š
- 24å°æ—¶ä¸é—´æ–­æœåŠ¡
- äº¤æ˜“æ•°æ®è¦æ±‚æé«˜å®‰å…¨æ€§
- æ³•å¾‹è¦æ±‚æ•°æ®å¤‡ä»½å®Œæ•´
```

---

## 2. ğŸ“‹ éƒ¨ç½²è§„åˆ’ç­–ç•¥


### 2.1 é›†ç¾¤æ¶æ„é€‰æ‹©


**ğŸ—ï¸ å¸¸è§é›†ç¾¤æ¶æ„å¯¹æ¯”**

| æ¶æ„ç±»å‹ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **ä¸»ä»å¤åˆ¶** | `ç®€å•æ˜“å®ç°ï¼Œæˆæœ¬ä½` | `ä¸»æœºæ•…éšœéœ€æ‰‹åŠ¨åˆ‡æ¢` | `è¯»å¤šå†™å°‘çš„åº”ç”¨` |
| **ä¸»ä¸»å¤åˆ¶** | `åŒå‘è¯»å†™ï¼Œè‡ªåŠ¨åˆ‡æ¢` | `æ•°æ®å†²çªé£é™©é«˜` | `å°è§„æ¨¡é«˜å¯ç”¨éœ€æ±‚` |
| **MHAæ¶æ„** | `è‡ªåŠ¨æ•…éšœåˆ‡æ¢` | `é…ç½®å¤æ‚ï¼Œéœ€è¦ä¸“ä¸šç»´æŠ¤` | `ç”Ÿäº§ç¯å¢ƒé«˜å¯ç”¨` |
| **MGRé›†ç¾¤** | `åŸç”Ÿé«˜å¯ç”¨ï¼Œä¸€è‡´æ€§å¥½` | `æ€§èƒ½å¼€é”€å¤§` | `å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜` |

### 2.2 æœåŠ¡å™¨è§„åˆ’åŸåˆ™


**ğŸ’» ç¡¬ä»¶é…ç½®è§„åˆ’**
```
åŸºç¡€é…ç½®å‚è€ƒï¼š

å°å‹é›†ç¾¤ï¼ˆ3-5å°ï¼‰ï¼š
- CPUï¼š8æ ¸ä»¥ä¸Š
- å†…å­˜ï¼š32GBä»¥ä¸Š
- ç¡¬ç›˜ï¼šSSD 500GBä»¥ä¸Š
- ç½‘ç»œï¼šåƒå…†ç½‘å¡

ä¸­å‹é›†ç¾¤ï¼ˆ5-10å°ï¼‰ï¼š
- CPUï¼š16æ ¸ä»¥ä¸Š
- å†…å­˜ï¼š64GBä»¥ä¸Š
- ç¡¬ç›˜ï¼šSSD 1TBä»¥ä¸Š
- ç½‘ç»œï¼šä¸‡å…†ç½‘å¡

å¤§å‹é›†ç¾¤ï¼ˆ10å°ä»¥ä¸Šï¼‰ï¼š
- CPUï¼š32æ ¸ä»¥ä¸Š
- å†…å­˜ï¼š128GBä»¥ä¸Š
- ç¡¬ç›˜ï¼šé«˜æ€§èƒ½SSD 2TBä»¥ä¸Š
- ç½‘ç»œï¼šä¸‡å…†ç½‘å¡+å†—ä½™é“¾è·¯
```

### 2.3 ç½‘ç»œè§„åˆ’è¦ç‚¹


**ğŸŒ ç½‘ç»œæ¶æ„è®¾è®¡**
```
ç½‘ç»œåˆ†å±‚è®¾è®¡ï¼š

ç®¡ç†ç½‘ç»œï¼š
- ç”¨é€”ï¼šè¿ç»´ç®¡ç†ã€ç›‘æ§
- ç‰¹ç‚¹ï¼šç‹¬ç«‹ç½‘æ®µï¼Œå®‰å…¨æ€§é«˜
- ç¤ºä¾‹ï¼š192.168.1.0/24

ä¸šåŠ¡ç½‘ç»œï¼š
- ç”¨é€”ï¼šåº”ç”¨è¿æ¥æ•°æ®åº“
- ç‰¹ç‚¹ï¼šé«˜å¸¦å®½ï¼Œä½å»¶è¿Ÿ
- ç¤ºä¾‹ï¼š10.0.1.0/24

å¤åˆ¶ç½‘ç»œï¼š
- ç”¨é€”ï¼šæ•°æ®åº“ä¸»ä»å¤åˆ¶
- ç‰¹ç‚¹ï¼šä¸“ç”¨ç½‘ç»œï¼Œé¿å…å¹²æ‰°
- ç¤ºä¾‹ï¼š172.16.1.0/24
```

**ğŸ”§ ç½‘ç»œé…ç½®ç¤ºä¾‹**
```bash
# é…ç½®å¤šç½‘å¡ç»‘å®šï¼ˆæé«˜å¯é æ€§ï¼‰
cat > /etc/sysconfig/network-scripts/ifcfg-bond0 << EOF
DEVICE=bond0
BONDING_OPTS="mode=1 miimon=100"
ONBOOT=yes
BOOTPROTO=static
IPADDR=10.0.1.100
NETMASK=255.255.255.0
EOF
```

---

## 3. ğŸ“ ç¯å¢ƒå‡†å¤‡æ¸…å•


### 3.1 æ“ä½œç³»ç»Ÿå‡†å¤‡


**ğŸ§ ç³»ç»Ÿç¯å¢ƒé…ç½®**

> ğŸ’¡ **é‡è¦æç¤º**ï¼šæ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹çš„ç³»ç»Ÿé…ç½®å¿…é¡»ä¿æŒä¸€è‡´ï¼Œé¿å…å› ç¯å¢ƒå·®å¼‚å¯¼è‡´çš„é—®é¢˜

**åŸºç¡€ç³»ç»Ÿè®¾ç½®**
```bash
# 1. å…³é—­SELinuxï¼ˆé¿å…æƒé™é—®é¢˜ï¼‰
setenforce 0
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config

# 2. å…³é—­é˜²ç«å¢™ï¼ˆå†…ç½‘ç¯å¢ƒï¼Œç®€åŒ–é…ç½®ï¼‰
systemctl stop firewalld
systemctl disable firewalld

# 3. æ—¶é—´åŒæ­¥ï¼ˆé›†ç¾¤èŠ‚ç‚¹æ—¶é—´å¿…é¡»ä¸€è‡´ï¼‰
yum install -y ntp
systemctl enable ntpd
systemctl start ntpd
```

### 3.2 ç³»ç»Ÿå‚æ•°ä¼˜åŒ–


**âš™ï¸ å…³é”®å‚æ•°è°ƒä¼˜**
```bash
# ç¼–è¾‘ç³»ç»Ÿå‚æ•°æ–‡ä»¶
cat >> /etc/sysctl.conf << EOF
# ç½‘ç»œè¿æ¥æ•°ä¼˜åŒ–
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 65535

# å†…å­˜ç®¡ç†ä¼˜åŒ–
vm.swappiness = 1
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5

# æ–‡ä»¶å¥æŸ„æ•°ä¼˜åŒ–
fs.file-max = 6553560
EOF

# åº”ç”¨é…ç½®
sysctl -p
```

**ğŸ“ æ–‡ä»¶å¥æŸ„é™åˆ¶è®¾ç½®**
```bash
cat >> /etc/security/limits.conf << EOF
mysql soft nofile 65535
mysql hard nofile 65535
mysql soft nproc 65535
mysql hard nproc 65535
EOF
```

### 3.3 MySQLè½¯ä»¶å‡†å¤‡


**ğŸ“¦ MySQLå®‰è£…å‡†å¤‡**
```bash
# 1. ä¸‹è½½MySQLå®˜æ–¹YUMæº
wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
rpm -ivh mysql80-community-release-el7-3.noarch.rpm

# 2. å®‰è£…MySQLæœåŠ¡å™¨
yum install -y mysql-community-server

# 3. åˆ›å»ºMySQLæ•°æ®ç›®å½•
mkdir -p /data/mysql
chown -R mysql:mysql /data/mysql
```

---

## 4. ğŸ”„ éƒ¨ç½²æµç¨‹æ ‡å‡†åŒ–


### 4.1 éƒ¨ç½²æµç¨‹è®¾è®¡


**ğŸ“Š æ ‡å‡†åŒ–éƒ¨ç½²æµç¨‹å›¾**
```
éƒ¨ç½²å‡†å¤‡é˜¶æ®µ
    â†“
ç¯å¢ƒæ£€æŸ¥ä¸éªŒè¯
    â†“
MySQLè½¯ä»¶å®‰è£…
    â†“
é…ç½®æ–‡ä»¶éƒ¨ç½²
    â†“
æ•°æ®åº“åˆå§‹åŒ–
    â†“
é›†ç¾¤é…ç½®å»ºç«‹
    â†“
æœåŠ¡å¯åŠ¨éªŒè¯
    â†“
åŠŸèƒ½æµ‹è¯•ç¡®è®¤
    â†“
æ€§èƒ½åŸºå‡†æµ‹è¯•
    â†“
éƒ¨ç½²å®Œæˆ
```

### 4.2 åˆ†é˜¶æ®µéƒ¨ç½²ç­–ç•¥


**ğŸ¯ é˜¶æ®µåŒ–éƒ¨ç½²æ–¹æ¡ˆ**

**ç¬¬ä¸€é˜¶æ®µï¼šä¸»åº“éƒ¨ç½²**
```bash
#!/bin/bash
# ä¸»åº“éƒ¨ç½²è„šæœ¬

echo "=== å¼€å§‹éƒ¨ç½²MySQLä¸»åº“ ==="

# 1. åˆå§‹åŒ–æ•°æ®åº“
mysqld --initialize-insecure --user=mysql --datadir=/data/mysql

# 2. å¯åŠ¨MySQLæœåŠ¡
systemctl start mysqld
systemctl enable mysqld

# 3. è®¾ç½®rootå¯†ç 
mysql -u root << EOF
ALTER USER 'root'@'localhost' IDENTIFIED BY 'YourStrongPassword';
FLUSH PRIVILEGES;
EOF

echo "=== ä¸»åº“éƒ¨ç½²å®Œæˆ ==="
```

**ç¬¬äºŒé˜¶æ®µï¼šä»åº“éƒ¨ç½²**
```bash
#!/bin/bash
# ä»åº“éƒ¨ç½²è„šæœ¬

echo "=== å¼€å§‹éƒ¨ç½²MySQLä»åº“ ==="

# 1. ä»ä¸»åº“å¤‡ä»½æ•°æ®
mysqldump -hä¸»åº“IP -u root -p --all-databases --master-data=2 > master_backup.sql

# 2. æ¢å¤æ•°æ®åˆ°ä»åº“
mysql -u root -p < master_backup.sql

# 3. é…ç½®ä¸»ä»å¤åˆ¶
mysql -u root -p << EOF
CHANGE MASTER TO 
  MASTER_HOST='ä¸»åº“IP',
  MASTER_USER='repl_user',
  MASTER_PASSWORD='repl_password',
  MASTER_LOG_FILE='mysql-bin.000001',
  MASTER_LOG_POS=154;
START SLAVE;
EOF

echo "=== ä»åº“éƒ¨ç½²å®Œæˆ ==="
```

### 4.3 éƒ¨ç½²æ£€æŸ¥æ¸…å•


**âœ… å…³é”®æ£€æŸ¥é¡¹**
```
éƒ¨ç½²å‰æ£€æŸ¥ï¼š
- [ ] æœåŠ¡å™¨ç¡¬ä»¶é…ç½®æ˜¯å¦æ»¡è¶³è¦æ±‚
- [ ] ç½‘ç»œè¿é€šæ€§æ˜¯å¦æ­£å¸¸
- [ ] æ“ä½œç³»ç»Ÿç‰ˆæœ¬æ˜¯å¦ä¸€è‡´
- [ ] ç³»ç»Ÿå‚æ•°æ˜¯å¦å·²ä¼˜åŒ–

éƒ¨ç½²ä¸­æ£€æŸ¥ï¼š
- [ ] MySQLå®‰è£…æ˜¯å¦æˆåŠŸ
- [ ] é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
- [ ] æ•°æ®ç›®å½•æƒé™æ˜¯å¦æ­£ç¡®
- [ ] æœåŠ¡å¯åŠ¨æ˜¯å¦æ­£å¸¸

éƒ¨ç½²åæ£€æŸ¥ï¼š
- [ ] é›†ç¾¤çŠ¶æ€æ˜¯å¦æ­£å¸¸
- [ ] æ•°æ®å¤åˆ¶æ˜¯å¦å·¥ä½œ
- [ ] åº”ç”¨è¿æ¥æ˜¯å¦æ­£å¸¸
- [ ] æ€§èƒ½æŒ‡æ ‡æ˜¯å¦è¾¾æ ‡
```

---

## 5. ğŸ“‹ é…ç½®æ¨¡æ¿ç®¡ç†


### 5.1 ä¸»åº“é…ç½®æ¨¡æ¿


**ğŸ”§ ä¸»åº“my.cnfé…ç½®**
```ini
[mysqld]
# === åŸºç¡€é…ç½® ===
server-id = 1
port = 3306
datadir = /data/mysql
socket = /tmp/mysql.sock

# === å­—ç¬¦é›†é…ç½® ===
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# === äºŒè¿›åˆ¶æ—¥å¿—é…ç½®ï¼ˆä¸»ä»å¤åˆ¶å¿…éœ€ï¼‰===
log-bin = mysql-bin
binlog-format = ROW
expire-logs-days = 7
max-binlog-size = 100M

# === å†…å­˜é…ç½® ===
innodb-buffer-pool-size = 4G
innodb-log-file-size = 256M
innodb-log-buffer-size = 16M

# === è¿æ¥é…ç½® ===
max-connections = 1000
max-user-connections = 950

# === æ€§èƒ½ä¼˜åŒ– ===
innodb-flush-log-at-trx-commit = 1
sync-binlog = 1
innodb-flush-method = O_DIRECT
```

### 5.2 ä»åº“é…ç½®æ¨¡æ¿


**ğŸ”§ ä»åº“my.cnfé…ç½®**
```ini
[mysqld]
# === åŸºç¡€é…ç½® ===
server-id = 2  # æ¯ä¸ªä»åº“IDå¿…é¡»ä¸åŒ
port = 3306
datadir = /data/mysql
socket = /tmp/mysql.sock

# === å­—ç¬¦é›†é…ç½® ===
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# === ä»åº“ç‰¹æ®Šé…ç½® ===
read-only = 1  # ä»åº“åªè¯»
super-read-only = 1
relay-log = mysql-relay-bin
log-slave-updates = 1

# === å†…å­˜é…ç½® ===
innodb-buffer-pool-size = 4G
innodb-log-file-size = 256M
innodb-log-buffer-size = 16M

# === è¿æ¥é…ç½® ===
max-connections = 1000
max-user-connections = 950
```

### 5.3 é…ç½®å‚æ•°åŒ–ç®¡ç†


**ğŸ¯ é…ç½®æ¨¡æ¿å˜é‡åŒ–**
```bash
# é…ç½®ç”Ÿæˆè„šæœ¬
#!/bin/bash

# å®šä¹‰å˜é‡
SERVER_ID=$1
SERVER_ROLE=$2  # master æˆ– slave
BUFFER_POOL_SIZE=$3

# ç”Ÿæˆé…ç½®æ–‡ä»¶
cat > /etc/my.cnf << EOF
[mysqld]
server-id = ${SERVER_ID}
EOF

if [ "$SERVER_ROLE" = "slave" ]; then
    cat >> /etc/my.cnf << EOF
read-only = 1
super-read-only = 1
EOF
fi

echo "é…ç½®æ–‡ä»¶ç”Ÿæˆå®Œæˆ"
```

---

## 6. ğŸ§ª éƒ¨ç½²éªŒè¯æµ‹è¯•


### 6.1 åŸºç¡€åŠŸèƒ½éªŒè¯


**âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥**
```bash
#!/bin/bash
# MySQLæœåŠ¡çŠ¶æ€æ£€æŸ¥è„šæœ¬

echo "=== MySQLæœåŠ¡çŠ¶æ€æ£€æŸ¥ ==="

# 1. æ£€æŸ¥MySQLè¿›ç¨‹
if pgrep mysqld > /dev/null; then
    echo "âœ… MySQLè¿›ç¨‹è¿è¡Œæ­£å¸¸"
else
    echo "âŒ MySQLè¿›ç¨‹æœªè¿è¡Œ"
    exit 1
fi

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
if netstat -ln | grep :3306 > /dev/null; then
    echo "âœ… MySQLç«¯å£ç›‘å¬æ­£å¸¸"
else
    echo "âŒ MySQLç«¯å£æœªç›‘å¬"
    exit 1
fi

# 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
if mysql -u root -p${MYSQL_ROOT_PASSWORD} -e "SELECT 1" > /dev/null 2>&1; then
    echo "âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸"
else
    echo "âŒ æ•°æ®åº“è¿æ¥å¤±è´¥"
    exit 1
fi

echo "=== åŸºç¡€åŠŸèƒ½éªŒè¯å®Œæˆ ==="
```

### 6.2 ä¸»ä»å¤åˆ¶éªŒè¯


**ğŸ”„ å¤åˆ¶çŠ¶æ€æ£€æŸ¥**
```sql
-- åœ¨ä¸»åº“æ‰§è¡Œ
SHOW MASTER STATUS;

-- é¢„æœŸç»“æœï¼š
-- +------------------+----------+--------------+------------------+
-- | File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |
-- +------------------+----------+--------------+------------------+
-- | mysql-bin.000001 |      154 |              |                  |
-- +------------------+----------+--------------+------------------+

-- åœ¨ä»åº“æ‰§è¡Œ
SHOW SLAVE STATUS\G

-- å…³é”®å­—æ®µæ£€æŸ¥ï¼š
-- Slave_IO_Running: Yes     ï¼ˆIOçº¿ç¨‹è¿è¡Œæ­£å¸¸ï¼‰
-- Slave_SQL_Running: Yes    ï¼ˆSQLçº¿ç¨‹è¿è¡Œæ­£å¸¸ï¼‰
-- Seconds_Behind_Master: 0  ï¼ˆå»¶è¿Ÿä¸º0ç§’ï¼‰
```

### 6.3 æ•°æ®ä¸€è‡´æ€§éªŒè¯


**ğŸ” æ•°æ®åŒæ­¥æµ‹è¯•**
```sql
-- åœ¨ä¸»åº“åˆ›å»ºæµ‹è¯•æ•°æ®
CREATE DATABASE test_replication;
USE test_replication;

CREATE TABLE test_table (
    id INT PRIMARY KEY AUTO_INCREMENT,
    data VARCHAR(100),
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO test_table (data) VALUES ('æµ‹è¯•æ•°æ®1'), ('æµ‹è¯•æ•°æ®2');

-- åœ¨ä»åº“æ£€æŸ¥æ•°æ®
USE test_replication;
SELECT * FROM test_table;

-- å¦‚æœèƒ½æŸ¥åˆ°ç›¸åŒæ•°æ®ï¼Œè¯´æ˜å¤åˆ¶æ­£å¸¸
```

---

## 7. ğŸ”™ éƒ¨ç½²å›æ»šæ–¹æ¡ˆ


### 7.1 å›æ»šç­–ç•¥è®¾è®¡


**ğŸ¯ å›æ»šåœºæ™¯åˆ†ç±»**

> âš ï¸ **é‡è¦è¯´æ˜**ï¼šå›æ»šæ˜¯ä¿è¯ç³»ç»Ÿç¨³å®šçš„æœ€åä¸€é“é˜²çº¿ï¼Œä½†é¢„é˜²æ°¸è¿œæ¯”æ²»ç–—é‡è¦

**å¸¸è§å›æ»šåœºæ™¯**
```
é…ç½®é”™è¯¯å›æ»šï¼š
- é—®é¢˜ï¼šé…ç½®æ–‡ä»¶é”™è¯¯å¯¼è‡´æœåŠ¡æ— æ³•å¯åŠ¨
- æ–¹æ¡ˆï¼šæ¢å¤ä¹‹å‰çš„é…ç½®æ–‡ä»¶å¤‡ä»½
- æ—¶é—´ï¼š5-10åˆ†é’Ÿ

æ•°æ®æŸåå›æ»šï¼š
- é—®é¢˜ï¼šæ•°æ®åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯
- æ–¹æ¡ˆï¼šåˆ é™¤æ•°æ®ç›®å½•ï¼Œé‡æ–°åˆå§‹åŒ–
- æ—¶é—´ï¼š10-30åˆ†é’Ÿ

é›†ç¾¤å¼‚å¸¸å›æ»šï¼š
- é—®é¢˜ï¼šé›†ç¾¤é…ç½®é”™è¯¯ï¼ŒèŠ‚ç‚¹æ— æ³•åŠ å…¥
- æ–¹æ¡ˆï¼šå›é€€åˆ°å•æœºæ¨¡å¼è¿è¡Œ
- æ—¶é—´ï¼š15-45åˆ†é’Ÿ
```

### 7.2 å¤‡ä»½éªŒè¯æœºåˆ¶


**ğŸ’¾ å…³é”®å¤‡ä»½é¡¹**
```bash
#!/bin/bash
# éƒ¨ç½²å‰å¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/mysql_deploy_$(date +%Y%m%d_%H%M%S)"
mkdir -p $BACKUP_DIR

echo "=== å¼€å§‹éƒ¨ç½²å‰å¤‡ä»½ ==="

# 1. å¤‡ä»½é…ç½®æ–‡ä»¶
cp /etc/my.cnf $BACKUP_DIR/my.cnf.bak 2>/dev/null

# 2. å¤‡ä»½æ•°æ®ç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
if [ -d "/data/mysql" ]; then
    tar -czf $BACKUP_DIR/mysql_data.tar.gz /data/mysql
fi

# 3. å¤‡ä»½ç³»ç»Ÿé…ç½®
cp /etc/sysctl.conf $BACKUP_DIR/sysctl.conf.bak
cp /etc/security/limits.conf $BACKUP_DIR/limits.conf.bak

echo "=== å¤‡ä»½å®Œæˆï¼Œå¤‡ä»½ç›®å½•ï¼š$BACKUP_DIR ==="
```

### 7.3 å¿«é€Ÿå›æ»šæµç¨‹


**âš¡ ç´§æ€¥å›æ»šæ­¥éª¤**
```bash
#!/bin/bash
# å¿«é€Ÿå›æ»šè„šæœ¬

BACKUP_DIR=$1

if [ -z "$BACKUP_DIR" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <å¤‡ä»½ç›®å½•>"
    exit 1
fi

echo "=== å¼€å§‹å›æ»šæ“ä½œ ==="

# 1. åœæ­¢MySQLæœåŠ¡
systemctl stop mysqld

# 2. æ¢å¤é…ç½®æ–‡ä»¶
if [ -f "$BACKUP_DIR/my.cnf.bak" ]; then
    cp $BACKUP_DIR/my.cnf.bak /etc/my.cnf
    echo "âœ… é…ç½®æ–‡ä»¶å·²æ¢å¤"
fi

# 3. æ¢å¤æ•°æ®ç›®å½•ï¼ˆå¦‚æœéœ€è¦ï¼‰
if [ -f "$BACKUP_DIR/mysql_data.tar.gz" ]; then
    rm -rf /data/mysql
    tar -xzf $BACKUP_DIR/mysql_data.tar.gz -C /
    chown -R mysql:mysql /data/mysql
    echo "âœ… æ•°æ®ç›®å½•å·²æ¢å¤"
fi

# 4. å¯åŠ¨æœåŠ¡
systemctl start mysqld

echo "=== å›æ»šæ“ä½œå®Œæˆ ==="
```

---

## 8. ğŸ”„ è“ç»¿éƒ¨ç½²ä¸ç°åº¦ç­–ç•¥


### 8.1 è“ç»¿éƒ¨ç½²åŸç†


**ğŸ¨ è“ç»¿éƒ¨ç½²æ¦‚å¿µ**

è“ç»¿éƒ¨ç½²æ˜¯ä¸€ç§é›¶åœæœºçš„éƒ¨ç½²æ–¹å¼ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å‡†å¤‡ä¸¤å¥—å®Œå…¨ç›¸åŒçš„ç¯å¢ƒï¼š
- **è“ç¯å¢ƒ**ï¼šå½“å‰æ­£åœ¨æä¾›æœåŠ¡çš„ç¯å¢ƒ
- **ç»¿ç¯å¢ƒ**ï¼šæ–°ç‰ˆæœ¬éƒ¨ç½²çš„ç¯å¢ƒ

å½“ç»¿ç¯å¢ƒæµ‹è¯•é€šè¿‡åï¼Œä¸€æ¬¡æ€§åˆ‡æ¢æµé‡åˆ°ç»¿ç¯å¢ƒï¼Œå®ç°æ— ç¼å‡çº§ã€‚

**ğŸ”„ è“ç»¿éƒ¨ç½²æµç¨‹å›¾**
```
æ­¥éª¤1ï¼šè“ç¯å¢ƒæä¾›æœåŠ¡
åº”ç”¨ â”€â”€â†’ è´Ÿè½½å‡è¡¡å™¨ â”€â”€â†’ è“ç¯å¢ƒ(MySQLé›†ç¾¤)
                      â•±
                    ç»¿ç¯å¢ƒ(ç©ºé—²)

æ­¥éª¤2ï¼šç»¿ç¯å¢ƒéƒ¨ç½²æ–°ç‰ˆæœ¬
åº”ç”¨ â”€â”€â†’ è´Ÿè½½å‡è¡¡å™¨ â”€â”€â†’ è“ç¯å¢ƒ(MySQLé›†ç¾¤)
                      â•±
                    ç»¿ç¯å¢ƒ(éƒ¨ç½²ä¸­...)

æ­¥éª¤3ï¼šæµé‡åˆ‡æ¢åˆ°ç»¿ç¯å¢ƒ
åº”ç”¨ â”€â”€â†’ è´Ÿè½½å‡è¡¡å™¨ â”€â”€â†’ ç»¿ç¯å¢ƒ(MySQLé›†ç¾¤)
                      â•±
                    è“ç¯å¢ƒ(å¤‡ç”¨)
```

### 8.2 MySQLè“ç»¿éƒ¨ç½²å®æ–½


**ğŸ› ï¸ è“ç»¿éƒ¨ç½²é…ç½®**
```bash
#!/bin/bash
# MySQLè“ç»¿éƒ¨ç½²è„šæœ¬

BLUE_VIP="10.0.1.100"   # è“ç¯å¢ƒVIP
GREEN_VIP="10.0.1.101"  # ç»¿ç¯å¢ƒVIP
ACTIVE_ENV="blue"       # å½“å‰æ´»è·ƒç¯å¢ƒ

# æµé‡åˆ‡æ¢å‡½æ•°
switch_traffic() {
    local target_env=$1
    
    if [ "$target_env" = "green" ]; then
        # åˆ‡æ¢åˆ°ç»¿ç¯å¢ƒ
        echo "åˆ‡æ¢æµé‡åˆ°ç»¿ç¯å¢ƒ..."
        # è¿™é‡Œä¼šè°ƒç”¨è´Ÿè½½å‡è¡¡å™¨APIæˆ–ä¿®æ”¹DNSè®°å½•
        update_load_balancer $GREEN_VIP
        ACTIVE_ENV="green"
    else
        # åˆ‡æ¢åˆ°è“ç¯å¢ƒ
        echo "åˆ‡æ¢æµé‡åˆ°è“ç¯å¢ƒ..."
        update_load_balancer $BLUE_VIP
        ACTIVE_ENV="blue"
    fi
    
    echo "æµé‡åˆ‡æ¢å®Œæˆï¼Œå½“å‰æ´»è·ƒç¯å¢ƒï¼š$ACTIVE_ENV"
}

# éƒ¨ç½²éªŒè¯å‡½æ•°
validate_deployment() {
    local env_vip=$1
    
    # æ£€æŸ¥æ•°æ®åº“è¿æ¥
    if mysql -h$env_vip -u health_check -på¥åº·æ£€æŸ¥å¯†ç  -e "SELECT 1" > /dev/null 2>&1; then
        echo "âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸"
        return 0
    else
        echo "âŒ æ•°æ®åº“è¿æ¥å¤±è´¥"
        return 1
    fi
}
```

### 8.3 ç°åº¦å‘å¸ƒç­–ç•¥


**ğŸ“ˆ ç°åº¦å‘å¸ƒåŸç†**

ç°åº¦å‘å¸ƒæ˜¯é€æ­¥å‘å¸ƒçš„ç­–ç•¥ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§åˆ‡æ¢æ‰€æœ‰æµé‡ï¼Œè€Œæ˜¯å…ˆåˆ‡æ¢ä¸€å°éƒ¨åˆ†æµé‡åˆ°æ–°ç¯å¢ƒï¼ŒéªŒè¯æ²¡é—®é¢˜åå†é€æ­¥å¢åŠ ã€‚

**ğŸ¯ ç°åº¦å‘å¸ƒé…ç½®**
```bash
#!/bin/bash
# MySQLç°åº¦å‘å¸ƒè„šæœ¬

# å®šä¹‰ç°åº¦æ¯”ä¾‹
GRAY_RATIOS=(10 30 50 80 100)  # 10% -> 30% -> 50% -> 80% -> 100%

# æ‰§è¡Œç°åº¦å‘å¸ƒ
for ratio in "${GRAY_RATIOS[@]}"; do
    echo "=== å¼€å§‹ ${ratio}% ç°åº¦å‘å¸ƒ ==="
    
    # é…ç½®è´Ÿè½½å‡è¡¡å™¨æµé‡åˆ†é…
    configure_traffic_split $ratio
    
    # ç­‰å¾…è§‚å¯ŸæœŸ
    echo "ç­‰å¾…è§‚å¯ŸæœŸï¼ˆ5åˆ†é’Ÿï¼‰..."
    sleep 300
    
    # æ£€æŸ¥å…³é”®æŒ‡æ ‡
    if check_key_metrics; then
        echo "âœ… ${ratio}% ç°åº¦å‘å¸ƒæˆåŠŸ"
    else
        echo "âŒ ${ratio}% ç°åº¦å‘å¸ƒå¤±è´¥ï¼Œå¼€å§‹å›æ»š"
        rollback_traffic
        exit 1
    fi
done

echo "ğŸ‰ ç°åº¦å‘å¸ƒå®Œæˆ"
```

---

## 9. ğŸ³ å®¹å™¨åŒ–é›†ç¾¤éƒ¨ç½²


### 9.1 å®¹å™¨åŒ–éƒ¨ç½²ä¼˜åŠ¿


**ğŸ“¦ å®¹å™¨åŒ–çš„å¥½å¤„**

å®¹å™¨åŒ–éƒ¨ç½²å°±æ˜¯æŠŠMySQLæ”¾åœ¨Dockerå®¹å™¨é‡Œè¿è¡Œï¼Œè¿™æ ·åšæœ‰å¾ˆå¤šå¥½å¤„ï¼š

```
ç¯å¢ƒä¸€è‡´æ€§ï¼š
- å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
- é¿å…"åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘"çš„é—®é¢˜

å¿«é€Ÿéƒ¨ç½²ï¼š
- å®¹å™¨å¯åŠ¨æ¯”è™šæ‹Ÿæœºå¿«å¾ˆå¤š
- å‡ ç§’é’Ÿå°±èƒ½å¯åŠ¨ä¸€ä¸ªMySQLå®ä¾‹

èµ„æºéš”ç¦»ï¼š
- æ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„èµ„æºé™åˆ¶
- ä¸ä¼šç›¸äº’å½±å“

æ˜“äºç®¡ç†ï¼š
- ç»Ÿä¸€çš„é•œåƒç®¡ç†
- æ–¹ä¾¿ç‰ˆæœ¬å›æ»š
```

### 9.2 Docker Composeéƒ¨ç½²æ–¹æ¡ˆ


**ğŸ³ Docker Composeé…ç½®**
```yaml
version: '3.8'

services:
  mysql-master:
    image: mysql:8.0
    container_name: mysql-master
    environment:
      MYSQL_ROOT_PASSWORD: YourStrongPassword
      MYSQL_USER: repl_user
      MYSQL_PASSWORD: repl_password
    volumes:
      - ./master/data:/var/lib/mysql
      - ./master/conf:/etc/mysql/conf.d
      - ./master/logs:/var/log/mysql
    ports:
      - "3306:3306"
    networks:
      - mysql-cluster
    restart: unless-stopped

  mysql-slave1:
    image: mysql:8.0
    container_name: mysql-slave1
    environment:
      MYSQL_ROOT_PASSWORD: YourStrongPassword
    volumes:
      - ./slave1/data:/var/lib/mysql
      - ./slave1/conf:/etc/mysql/conf.d
      - ./slave1/logs:/var/log/mysql
    ports:
      - "3307:3306"
    networks:
      - mysql-cluster
    depends_on:
      - mysql-master
    restart: unless-stopped

  mysql-slave2:
    image: mysql:8.0
    container_name: mysql-slave2
    environment:
      MYSQL_ROOT_PASSWORD: YourStrongPassword
    volumes:
      - ./slave2/data:/var/lib/mysql
      - ./slave2/conf:/etc/mysql/conf.d
      - ./slave2/logs:/var/log/mysql
    ports:
      - "3308:3306"
    networks:
      - mysql-cluster
    depends_on:
      - mysql-master
    restart: unless-stopped

networks:
  mysql-cluster:
    driver: bridge
```

### 9.3 Kuberneteséƒ¨ç½²æ–¹æ¡ˆ


**â˜¸ï¸ ç”Ÿäº§çº§K8séƒ¨ç½²**

> ğŸ’¡ **æç¤º**ï¼šKubernetesé€‚åˆå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒï¼Œæä¾›æ›´å¼ºçš„è‡ªåŠ¨åŒ–ç®¡ç†èƒ½åŠ›

**StatefulSeté…ç½®ç¤ºä¾‹**
```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql-cluster
spec:
  serviceName: mysql-cluster
  replicas: 3
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: password
        ports:
        - containerPort: 3306
        volumeMounts:
        - name: mysql-data
          mountPath: /var/lib/mysql
        - name: mysql-config
          mountPath: /etc/mysql/conf.d
  volumeClaimTemplates:
  - metadata:
      name: mysql-data
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 100Gi
```

---

## 10. âš ï¸ éƒ¨ç½²é£é™©è¯„ä¼°ä¸æ§åˆ¶


### 10.1 é£é™©è¯†åˆ«ä¸åˆ†ç±»


**ğŸ¯ éƒ¨ç½²é£é™©åˆ†ç±»**

**é«˜é£é™©é¡¹**
```
æ•°æ®ä¸¢å¤±é£é™©ï¼š
- åŸå› ï¼šå¤‡ä»½ä¸å®Œæ•´ã€æ“ä½œå¤±è¯¯
- å½±å“ï¼šä¸šåŠ¡æ•°æ®æ°¸ä¹…ä¸¢å¤±
- æ§åˆ¶ï¼šå¤šé‡å¤‡ä»½ã€æ“ä½œå®¡æ ¸

æœåŠ¡ä¸­æ–­é£é™©ï¼š
- åŸå› ï¼šéƒ¨ç½²è¿‡ç¨‹ä¸­æœåŠ¡åœæ­¢
- å½±å“ï¼šä¸šåŠ¡æ— æ³•æ­£å¸¸è¿è¡Œ
- æ§åˆ¶ï¼šåˆ†æ‰¹éƒ¨ç½²ã€è“ç»¿åˆ‡æ¢

é…ç½®é”™è¯¯é£é™©ï¼š
- åŸå› ï¼šå‚æ•°é…ç½®ä¸å½“
- å½±å“ï¼šæ€§èƒ½ä¸‹é™ã€åŠŸèƒ½å¼‚å¸¸
- æ§åˆ¶ï¼šé…ç½®æ¨¡æ¿ã€è‡ªåŠ¨åŒ–æ£€æŸ¥
```

**ä¸­ç­‰é£é™©é¡¹**
```
æ€§èƒ½ä¸‹é™é£é™©ï¼š
- åŸå› ï¼šç¡¬ä»¶èµ„æºä¸è¶³ã€å‚æ•°è°ƒä¼˜ä¸å½“
- å½±å“ï¼šå“åº”æ—¶é—´å¢åŠ 
- æ§åˆ¶ï¼šæ€§èƒ½æµ‹è¯•ã€èµ„æºç›‘æ§

å…¼å®¹æ€§é£é™©ï¼š
- åŸå› ï¼šç‰ˆæœ¬ä¸å…¼å®¹ã€ä¾èµ–é—®é¢˜
- å½±å“ï¼šåŠŸèƒ½å¼‚å¸¸
- æ§åˆ¶ï¼šå…¼å®¹æ€§æµ‹è¯•ã€ç‰ˆæœ¬ç®¡ç†
```

### 10.2 å®æ—¶é£é™©ç›‘æ§


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```bash
#!/bin/bash
# éƒ¨ç½²é£é™©ç›‘æ§è„šæœ¬

# å®šä¹‰å‘Šè­¦é˜ˆå€¼
CPU_THRESHOLD=80
MEMORY_THRESHOLD=85
DISK_THRESHOLD=90
REPLICATION_LAG_THRESHOLD=10

# ç³»ç»Ÿèµ„æºç›‘æ§
check_system_resources() {
    # CPUä½¿ç”¨ç‡
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | sed 's/%us,//')
    if (( $(echo "$CPU_USAGE > $CPU_THRESHOLD" | bc -l) )); then
        echo "âš ï¸ CPUä½¿ç”¨ç‡è¿‡é«˜: ${CPU_USAGE}%"
    fi
    
    # å†…å­˜ä½¿ç”¨ç‡
    MEMORY_USAGE=$(free | grep Mem | awk '{printf "%.1f", $3/$2 * 100.0}')
    if (( $(echo "$MEMORY_USAGE > $MEMORY_THRESHOLD" | bc -l) )); then
        echo "âš ï¸ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${MEMORY_USAGE}%"
    fi
    
    # ç£ç›˜ä½¿ç”¨ç‡
    DISK_USAGE=$(df -h /data/mysql | awk 'NR==2 {print $5}' | sed 's/%//')
    if [ "$DISK_USAGE" -gt "$DISK_THRESHOLD" ]; then
        echo "âš ï¸ ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: ${DISK_USAGE}%"
    fi
}

# MySQLå¤åˆ¶å»¶è¿Ÿç›‘æ§
check_replication_lag() {
    LAG=$(mysql -u monitor -pç›‘æ§å¯†ç  -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master" | awk '{print $2}')
    
    if [ "$LAG" != "NULL" ] && [ "$LAG" -gt "$REPLICATION_LAG_THRESHOLD" ]; then
        echo "âš ï¸ ä¸»ä»å¤åˆ¶å»¶è¿Ÿè¿‡é«˜: ${LAG}ç§’"
    fi
}

# æ‰§è¡Œç›‘æ§æ£€æŸ¥
echo "=== å¼€å§‹é£é™©ç›‘æ§æ£€æŸ¥ ==="
check_system_resources
check_replication_lag
echo "=== ç›‘æ§æ£€æŸ¥å®Œæˆ ==="
```

### 10.3 é£é™©åº”æ€¥é¢„æ¡ˆ


**ğŸš¨ åº”æ€¥å“åº”æµç¨‹**
```
Level 1 - è½»å¾®é—®é¢˜ï¼š
- è§¦å‘æ¡ä»¶ï¼šæ€§èƒ½æŒ‡æ ‡è½»å¾®å¼‚å¸¸
- å“åº”æ—¶é—´ï¼š30åˆ†é’Ÿå†…
- å¤„ç†æ–¹å¼ï¼šè°ƒæ•´å‚æ•°ã€é‡å¯æœåŠ¡
- è´£ä»»äººï¼šè¿ç»´å·¥ç¨‹å¸ˆ

Level 2 - ä¸­ç­‰é—®é¢˜ï¼š
- è§¦å‘æ¡ä»¶ï¼šæœåŠ¡éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸
- å“åº”æ—¶é—´ï¼š15åˆ†é’Ÿå†…
- å¤„ç†æ–¹å¼ï¼šå›æ»šé…ç½®ã€åˆ‡æ¢èŠ‚ç‚¹
- è´£ä»»äººï¼šé«˜çº§è¿ç»´å·¥ç¨‹å¸ˆ

Level 3 - ä¸¥é‡é—®é¢˜ï¼š
- è§¦å‘æ¡ä»¶ï¼šæœåŠ¡å®Œå…¨ä¸­æ–­
- å“åº”æ—¶é—´ï¼š5åˆ†é’Ÿå†…
- å¤„ç†æ–¹å¼ï¼šç«‹å³å›æ»šã€å¯åŠ¨åº”æ€¥æ–¹æ¡ˆ
- è´£ä»»äººï¼šè¿ç»´è´Ÿè´£äºº
```

---

## 11. ğŸ¤– éƒ¨ç½²è‡ªåŠ¨åŒ–å·¥å…·


### 11.1 Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²


**âš™ï¸ Ansibleéƒ¨ç½²ä¼˜åŠ¿**

Ansibleæ˜¯ä¸€ä¸ªå¼ºå¤§çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œå¯ä»¥å¸®æˆ‘ä»¬ï¼š
- **æ‰¹é‡æ“ä½œ**ï¼šåŒæ—¶åœ¨å¤šå°æœåŠ¡å™¨ä¸Šæ‰§è¡Œç›¸åŒæ“ä½œ
- **å¹‚ç­‰æ€§**ï¼šå¤šæ¬¡æ‰§è¡Œç»“æœä¸€è‡´ï¼Œä¸ä¼šé‡å¤æ“ä½œ
- **æ— ä»£ç†**ï¼šä¸éœ€è¦åœ¨ç›®æ ‡æœåŠ¡å™¨å®‰è£…å®¢æˆ·ç«¯
- **ç®€å•æ˜“å­¦**ï¼šä½¿ç”¨YAMLè¯­æ³•ï¼Œå®¹æ˜“ç†è§£

**ğŸ“‹ Ansible Playbookç¤ºä¾‹**
```yaml
---
- name: MySQLé›†ç¾¤è‡ªåŠ¨åŒ–éƒ¨ç½²
  hosts: mysql_servers
  become: yes
  vars:
    mysql_root_password: "YourStrongPassword"
    mysql_version: "8.0"
  
  tasks:
    - name: å®‰è£…MySQL YUMæº
      yum:
        name: mysql80-community-release-el7-3.noarch.rpm
        state: present

    - name: å®‰è£…MySQLæœåŠ¡å™¨
      yum:
        name: mysql-community-server
        state: present

    - name: åˆ›å»ºMySQLæ•°æ®ç›®å½•
      file:
        path: /data/mysql
        state: directory
        owner: mysql
        group: mysql
        mode: '0755'

    - name: éƒ¨ç½²MySQLé…ç½®æ–‡ä»¶
      template:
        src: my.cnf.j2
        dest: /etc/my.cnf
        backup: yes
      notify: restart mysql

    - name: å¯åŠ¨MySQLæœåŠ¡
      systemd:
        name: mysqld
        state: started
        enabled: yes

  handlers:
    - name: restart mysql
      systemd:
        name: mysqld
        state: restarted
```

### 11.2 TerraformåŸºç¡€è®¾æ–½å³ä»£ç 


**ğŸ—ï¸ åŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ–**
```hcl
# terraform/mysql-cluster.tf

# å®šä¹‰äº‘æœåŠ¡å™¨èµ„æº
resource "alicloud_instance" "mysql_servers" {
  count           = 3
  image_id        = "centos_7_9_x64_20G_alibase_20210128.vhd"
  instance_type   = "ecs.g6.large"
  security_groups = [alicloud_security_group.mysql_sg.id]
  
  instance_name = "mysql-server-${count.index + 1}"
  
  system_disk_category = "cloud_ssd"
  system_disk_size     = 40
  
  data_disks {
    name     = "mysql-data"
    size     = 100
    category = "cloud_ssd"
  }
  
  tags = {
    Environment = "production"
    Application = "mysql-cluster"
  }
}

# å®šä¹‰å®‰å…¨ç»„
resource "alicloud_security_group" "mysql_sg" {
  name_regex = "mysql-cluster-sg"
  
  tags = {
    Application = "mysql-cluster"
  }
}

# å®‰å…¨ç»„è§„åˆ™
resource "alicloud_security_group_rule" "mysql_port" {
  type              = "ingress"
  ip_protocol       = "tcp"
  port_range        = "3306/3306"
  security_group_id = alicloud_security_group.mysql_sg.id
  cidr_ip          = "10.0.0.0/8"
}
```

### 11.3 CI/CDé›†æˆéƒ¨ç½²


**ğŸ”„ Jenkins Pipelineé…ç½®**
```groovy
pipeline {
    agent any
    
    environment {
        MYSQL_ROOT_PASSWORD = credentials('mysql-root-password')
    }
    
    stages {
        stage('ç¯å¢ƒæ£€æŸ¥') {
            steps {
                script {
                    echo 'æ£€æŸ¥éƒ¨ç½²ç¯å¢ƒ...'
                    sh '''
                        ansible mysql_servers -m ping
                        ansible mysql_servers -m setup
                    '''
                }
            }
        }
        
        stage('éƒ¨ç½²MySQLé›†ç¾¤') {
            steps {
                script {
                    echo 'å¼€å§‹éƒ¨ç½²MySQLé›†ç¾¤...'
                    sh '''
                        ansible-playbook -i inventory/production \
                                       playbooks/mysql-cluster.yml \
                                       -e mysql_root_password=${MYSQL_ROOT_PASSWORD}
                    '''
                }
            }
        }
        
        stage('éƒ¨ç½²éªŒè¯') {
            steps {
                script {
                    echo 'éªŒè¯éƒ¨ç½²ç»“æœ...'
                    sh '''
                        ansible mysql_servers -m shell \
                                -a "systemctl status mysqld"
                        
                        # éªŒè¯ä¸»ä»å¤åˆ¶çŠ¶æ€
                        ansible mysql_slaves -m shell \
                                -a "mysql -u root -p${MYSQL_ROOT_PASSWORD} -e 'SHOW SLAVE STATUS\G'"
                    '''
                }
            }
        }
    }
    
    post {
        success {
            echo 'âœ… MySQLé›†ç¾¤éƒ¨ç½²æˆåŠŸ'
            // å‘é€æˆåŠŸé€šçŸ¥
        }
        
        failure {
            echo 'âŒ MySQLé›†ç¾¤éƒ¨ç½²å¤±è´¥'
            // å‘é€å¤±è´¥é€šçŸ¥å¹¶æ‰§è¡Œå›æ»š
            sh 'ansible-playbook playbooks/rollback.yml'
        }
    }
}
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ éƒ¨ç½²è§„åˆ’è¦ç‚¹**
- **æ¶æ„é€‰æ‹©**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„é›†ç¾¤æ¶æ„
- **èµ„æºè§„åˆ’**ï¼šç¡¬ä»¶é…ç½®è¦æ»¡è¶³ä¸šåŠ¡å¢é•¿éœ€æ±‚
- **ç½‘ç»œè®¾è®¡**ï¼šåˆ†å±‚ç½‘ç»œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨æ€§
- **é£é™©è¯„ä¼°**ï¼šæå‰è¯†åˆ«å’Œæ§åˆ¶éƒ¨ç½²é£é™©

**âš™ï¸ å®æ–½è¦ç‚¹**
- **æ ‡å‡†åŒ–æµç¨‹**ï¼šåˆ¶å®šè¯¦ç»†çš„éƒ¨ç½²æµç¨‹å’Œæ£€æŸ¥æ¸…å•
- **é…ç½®ç®¡ç†**ï¼šä½¿ç”¨æ¨¡æ¿åŒ–é…ç½®ï¼Œç¡®ä¿ä¸€è‡´æ€§
- **éªŒè¯æµ‹è¯•**ï¼šå…¨é¢çš„åŠŸèƒ½å’Œæ€§èƒ½éªŒè¯
- **å›æ»šå‡†å¤‡**ï¼šå®Œå–„çš„å¤‡ä»½å’Œå›æ»šæ–¹æ¡ˆ

### 12.2 æœ€ä½³å®è·µå»ºè®®


**ğŸ’¡ éƒ¨ç½²ç­–ç•¥**
```
å°è§„æ¨¡ç¯å¢ƒï¼š
- æ¨èä¸»ä»å¤åˆ¶æ¶æ„
- æ‰‹åŠ¨éƒ¨ç½²é…åˆè„šæœ¬
- ç®€åŒ–çš„ç›‘æ§æ–¹æ¡ˆ

ä¸­å‹ç¯å¢ƒï¼š
- æ¨èMHAæˆ–MGRæ¶æ„
- Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²
- å®Œæ•´çš„ç›‘æ§å‘Šè­¦

å¤§å‹ç¯å¢ƒï¼š
- æ¨èå®¹å™¨åŒ–éƒ¨ç½²
- CI/CDå…¨è‡ªåŠ¨åŒ–
- ä¸“ä¸šè¿ç»´å›¢é˜Ÿ
```

**ğŸš¨ å¸¸è§è¯¯åŒºé¿å…**
```
é…ç½®è¯¯åŒºï¼š
âŒ æ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨ç›¸åŒserver-id
âœ… æ¯ä¸ªèŠ‚ç‚¹å¿…é¡»æœ‰å”¯ä¸€server-id

ç½‘ç»œè¯¯åŒºï¼š
âŒ æ‰€æœ‰æµé‡èµ°åŒä¸€ç½‘ç»œ
âœ… ç®¡ç†ã€ä¸šåŠ¡ã€å¤åˆ¶ç½‘ç»œåˆ†ç¦»

å®‰å…¨è¯¯åŒºï¼š
âŒ ä½¿ç”¨å¼±å¯†ç æˆ–é»˜è®¤é…ç½®
âœ… å¼ºå¯†ç ã€æœ€å°æƒé™åŸåˆ™

å¤‡ä»½è¯¯åŒºï¼š
âŒ éƒ¨ç½²å‰ä¸åšå¤‡ä»½
âœ… éƒ¨ç½²å‰å®Œæ•´å¤‡ä»½ï¼Œå®šæœŸéªŒè¯
```

### 12.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸª ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç”µå•†å¹³å°**ï¼šåŒ11å¤§ä¿ƒå‰çš„é›†ç¾¤æ‰©å®¹éƒ¨ç½²
- **é‡‘èç³»ç»Ÿ**ï¼šé«˜å¯ç”¨MySQLé›†ç¾¤æ›¿æ¢å•æœºæ•°æ®åº“
- **æ¸¸æˆå…¬å¸**ï¼šæ–°åŒºå¼€æœçš„å¿«é€Ÿé›†ç¾¤éƒ¨ç½²
- **äº’è”ç½‘å…¬å¸**ï¼šå¾®æœåŠ¡åŒ–æ”¹é€ ä¸­çš„æ•°æ®åº“é›†ç¾¤éƒ¨ç½²

**ğŸ”§ è¿ç»´å®è·µä»·å€¼**
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„éƒ¨ç½²æµç¨‹ï¼Œå‡å°‘äººä¸ºé”™è¯¯
- **è‡ªåŠ¨åŒ–**ï¼šæé«˜éƒ¨ç½²æ•ˆç‡ï¼Œé™ä½è¿ç»´æˆæœ¬
- **å¯é æ€§**ï¼šå®Œå–„çš„éªŒè¯å’Œå›æ»šæœºåˆ¶ï¼Œä¿éšœç³»ç»Ÿç¨³å®š
- **å¯æ‰©å±•**ï¼šæ¨¡å—åŒ–çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œæ”¯æŒä¸šåŠ¡å¿«é€Ÿå‘å±•

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ğŸ“ éƒ¨ç½²ä¹‹å‰å…ˆè§„åˆ’ï¼Œç¯å¢ƒé…ç½®è¦æ ‡å‡†
> ğŸ”„ æµç¨‹æ¸…æ™°åˆ†æ­¥éª¤ï¼ŒéªŒè¯æµ‹è¯•ä¸èƒ½ç¼º
> ğŸ’¾ å¤‡ä»½å›æ»šè¦å®Œå–„ï¼Œè‡ªåŠ¨åŒ–å·¥å…·æ¥å¸®å¿™
> âš ï¸ é£é™©æ§åˆ¶è¦åˆ°ä½ï¼Œç›‘æ§å‘Šè­¦ä¿å¹³å®‰