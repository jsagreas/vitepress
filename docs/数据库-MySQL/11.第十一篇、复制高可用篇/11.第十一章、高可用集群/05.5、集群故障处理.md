---
title: 5ã€é›†ç¾¤æ•…éšœå¤„ç†
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤æ•…éšœå¤„ç†æ¦‚è¿°](#1-é›†ç¾¤æ•…éšœå¤„ç†æ¦‚è¿°)
2. [æ•…éšœæ£€æµ‹ä¸è¯†åˆ«](#2-æ•…éšœæ£€æµ‹ä¸è¯†åˆ«)
3. [æ•…éšœéš”ç¦»æœºåˆ¶](#3-æ•…éšœéš”ç¦»æœºåˆ¶)
4. [è‡ªåŠ¨æ•…éšœè½¬ç§»](#4-è‡ªåŠ¨æ•…éšœè½¬ç§»)
5. [æ•…éšœæ¢å¤ç­–ç•¥](#5-æ•…éšœæ¢å¤ç­–ç•¥)
6. [çº§è”æ•…éšœé¢„é˜²](#6-çº§è”æ•…éšœé¢„é˜²)
7. [åº”æ€¥å“åº”ä¸å¤„ç†](#7-åº”æ€¥å“åº”ä¸å¤„ç†)
8. [æ•…éšœé¢„é˜²æªæ–½](#8-æ•…éšœé¢„é˜²æªæ–½)
9. [æ™ºèƒ½åŒ–æ•…éšœç®¡ç†](#9-æ™ºèƒ½åŒ–æ•…éšœç®¡ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ é›†ç¾¤æ•…éšœå¤„ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯é›†ç¾¤æ•…éšœå¤„ç†


**é€šä¿—ç†è§£**ï¼š
æƒ³è±¡ä¸€ä¸ªå¤§å‹å•†åœºï¼Œå¦‚æœæŸä¸ªç”µæ¢¯åäº†ï¼Œå•†åœºéœ€è¦ï¼š
- å¿«é€Ÿå‘ç°é—®é¢˜ï¼ˆæ•…éšœæ£€æµ‹ï¼‰
- å¼•å¯¼é¡¾å®¢ä½¿ç”¨å…¶ä»–ç”µæ¢¯ï¼ˆæ•…éšœè½¬ç§»ï¼‰  
- ä¿®å¤åæ‰çš„ç”µæ¢¯ï¼ˆæ•…éšœæ¢å¤ï¼‰
- é˜²æ­¢å…¶ä»–ç”µæ¢¯è¿‡è½½ï¼ˆçº§è”æ•…éšœé¢„é˜²ï¼‰

MySQLé›†ç¾¤æ•…éšœå¤„ç†å°±æ˜¯è¿™æ ·ä¸€ä¸ªå®Œæ•´çš„åº”å¯¹æœºåˆ¶ã€‚

**æ ¸å¿ƒå®šä¹‰**ï¼š
```
é›†ç¾¤æ•…éšœå¤„ç† = æ•…éšœæ£€æµ‹ + æ•…éšœéš”ç¦» + æ•…éšœè½¬ç§» + æ•…éšœæ¢å¤
ç›®æ ‡ï¼šæœ€å°åŒ–æ•…éšœå½±å“ï¼Œå¿«é€Ÿæ¢å¤æœåŠ¡å¯ç”¨æ€§
```

### 1.2 æ•…éšœå¤„ç†çš„é‡è¦æ€§


**ğŸ¯ ä¸šåŠ¡å½±å“åˆ†æ**ï¼š
```
æ•…éšœå½±å“èŒƒå›´ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ä½“éªŒ      â”‚ â† å“åº”å˜æ…¢ã€æœåŠ¡ä¸­æ–­
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¸šåŠ¡æ”¶å…¥      â”‚ â† è®¢å•ä¸¢å¤±ã€äº¤æ˜“å¤±è´¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®å®Œæ•´æ€§    â”‚ â† æ•°æ®ä¸ä¸€è‡´ã€ä¸¢å¤±
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç³»ç»Ÿä¿¡èª‰      â”‚ â† ç”¨æˆ·æµå¤±ã€å£ç¢‘ä¸‹é™
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š æ•…éšœæˆæœ¬é‡åŒ–**ï¼š
| æ•…éšœæ—¶é•¿ | ä¸šåŠ¡å½±å“ | ç”¨æˆ·å½±å“ | é¢„ä¼°æŸå¤± |
|---------|---------|---------|---------|
| 1åˆ†é’Ÿ   | è½»å¾®    | éƒ¨åˆ†ç”¨æˆ· | è¾ƒå°    |
| 5åˆ†é’Ÿ   | ä¸­ç­‰    | å¤šæ•°ç”¨æˆ· | ä¸­ç­‰    |
| 30åˆ†é’Ÿ  | ä¸¥é‡    | å…¨éƒ¨ç”¨æˆ· | å·¨å¤§    |
| 2å°æ—¶   | ç¾éš¾æ€§   | ç”¨æˆ·æµå¤± | ä¸å¯ä¼°é‡ |

---

## 2. ğŸ” æ•…éšœæ£€æµ‹ä¸è¯†åˆ«


### 2.1 æ•…éšœæ£€æµ‹æ–¹æ³•


**ä¸»åŠ¨æ£€æµ‹æœºåˆ¶**ï¼š
```
å¥åº·æ£€æŸ¥ç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿æ¥æ£€æµ‹      â”‚ â† èƒ½å¦å»ºç«‹æ•°æ®åº“è¿æ¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æŸ¥è¯¢æ£€æµ‹      â”‚ â† SELECT 1 æ‰§è¡Œæ˜¯å¦æ­£å¸¸
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å†™å…¥æ£€æµ‹      â”‚ â† ç®€å•INSERTæ˜¯å¦æˆåŠŸ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å¤åˆ¶æ£€æµ‹      â”‚ â† ä¸»ä»å»¶è¿Ÿæ˜¯å¦æ­£å¸¸
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¢«åŠ¨æ£€æµ‹æœºåˆ¶**ï¼š
```sql
-- åŸºç¡€è¿æ¥æ£€æµ‹
SELECT 1 AS health_check;

-- å¤åˆ¶çŠ¶æ€æ£€æµ‹
SHOW SLAVE STATUS;

-- æ€§èƒ½æŒ‡æ ‡æ£€æµ‹
SHOW GLOBAL STATUS LIKE 'Threads_connected';
SHOW GLOBAL STATUS LIKE 'Slow_queries';
```

### 2.2 æ•…éšœè¯†åˆ«æ ‡å‡†


**ğŸš¦ æ•…éšœä¸¥é‡çº§åˆ«åˆ†ç±»**ï¼š

| çº§åˆ« | æè¿° | æ£€æµ‹æŒ‡æ ‡ | å“åº”æ—¶é—´ |
|------|------|----------|----------|
| **P0** | ğŸ”´ æœåŠ¡å®Œå…¨ä¸å¯ç”¨ | è¿æ¥å¤±è´¥100% | ç«‹å³ |
| **P1** | ğŸŸ  æœåŠ¡ä¸¥é‡å—å½±å“ | é”™è¯¯ç‡>50% | 5åˆ†é’Ÿå†… |
| **P2** | ğŸŸ¡ æœåŠ¡è½»å¾®å—å½±å“ | å“åº”æ—¶é—´>é˜ˆå€¼ | 30åˆ†é’Ÿå†… |
| **P3** | ğŸŸ¢ é¢„è­¦çŠ¶æ€ | èµ„æºä½¿ç”¨ç‡é«˜ | 2å°æ—¶å†… |

**æ£€æµ‹é˜ˆå€¼è®¾ç½®ç¤ºä¾‹**ï¼š
```yaml
# æ•…éšœæ£€æµ‹é…ç½®
health_check:
  connection_timeout: 5s
  query_timeout: 10s
  check_interval: 30s
  
thresholds:
  cpu_usage: 80%
  memory_usage: 85%
  disk_usage: 90%
  connection_usage: 90%
  slave_lag: 30s
```

### 2.3 æ•…éšœå½±å“é¢åˆ†æ


**å½±å“èŒƒå›´è¯„ä¼°æ¨¡å‹**ï¼š
```
æ•…éšœå½±å“è¯„ä¼°ï¼š
ç”¨æˆ·å½±å“æ•°é‡ = æ€»ç”¨æˆ· Ã— æ•…éšœèŠ‚ç‚¹æ‰¿è½½æ¯”ä¾‹
ä¸šåŠ¡å½±å“ç¨‹åº¦ = æ ¸å¿ƒä¸šåŠ¡å—å½±å“ + æ¬¡è¦ä¸šåŠ¡å—å½±å“
æ¢å¤æ—¶é—´é¢„ä¼° = æ£€æµ‹æ—¶é—´ + åˆ‡æ¢æ—¶é—´ + éªŒè¯æ—¶é—´
```

**å®é™…è®¡ç®—ç¤ºä¾‹**ï¼š
```
å‡è®¾åœºæ™¯ï¼š
- æ€»ç”¨æˆ·ï¼š100ä¸‡
- æ•…éšœèŠ‚ç‚¹æ‰¿è½½ï¼š30%
- æ ¸å¿ƒä¸šåŠ¡å—å½±å“ï¼šè®¢å•æ”¯ä»˜
- é¢„ä¼°æ¢å¤æ—¶é—´ï¼šæ£€æµ‹2åˆ†é’Ÿ + åˆ‡æ¢3åˆ†é’Ÿ + éªŒè¯1åˆ†é’Ÿ = 6åˆ†é’Ÿ

å½±å“è¯„ä¼°ï¼š
- å—å½±å“ç”¨æˆ·ï¼š30ä¸‡
- ä¸šåŠ¡æŸå¤±ï¼šæ”¯ä»˜æœåŠ¡ä¸­æ–­6åˆ†é’Ÿ
- ç´§æ€¥ç¨‹åº¦ï¼šP0çº§åˆ«ï¼Œéœ€è¦ç«‹å³å¤„ç†
```

---

## 3. ğŸ›¡ï¸ æ•…éšœéš”ç¦»æœºåˆ¶


### 3.1 æ•…éšœéš”ç¦»çš„åŸºæœ¬åŸç†


**é€šä¿—è§£é‡Š**ï¼š
å°±åƒé˜²ç«å¢™ä¸€æ ·ï¼Œå½“ä¸€æ ‹æ¥¼å‘ç”Ÿç«ç¾æ—¶ï¼Œè¦ç«‹å³å…³é—­é˜²ç«é—¨ï¼Œé˜²æ­¢ç«åŠ¿è”“å»¶åˆ°å…¶ä»–æ¥¼å±‚ã€‚æ•…éšœéš”ç¦»å°±æ˜¯è¦æŠŠæœ‰é—®é¢˜çš„æ•°æ®åº“èŠ‚ç‚¹"éš”ç¦»"èµ·æ¥ï¼Œä¸è®©å®ƒå½±å“å…¶ä»–æ­£å¸¸çš„èŠ‚ç‚¹ã€‚

**éš”ç¦»ç­–ç•¥**ï¼š
```
æ•…éšœéš”ç¦»å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç½‘ç»œéš”ç¦»      â”‚ â† æ–­å¼€ç½‘ç»œè¿æ¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœåŠ¡éš”ç¦»      â”‚ â† åœæ­¢å¯¹å¤–æœåŠ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æµé‡éš”ç¦»      â”‚ â† é‡å®šå‘æµé‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®éš”ç¦»      â”‚ â† åœæ­¢æ•°æ®åŒæ­¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 è‡ªåŠ¨éš”ç¦»æœºåˆ¶


**æ™ºèƒ½éš”ç¦»è§¦å‘æ¡ä»¶**ï¼š
```sql
-- è¿æ¥æ•°å¼‚å¸¸æ£€æµ‹
SELECT 
    VARIABLE_VALUE as current_connections,
    CASE 
        WHEN VARIABLE_VALUE > $$max_connections * 0.9 
        THEN 'CRITICAL' 
        ELSE 'NORMAL' 
    END as status
FROM INFORMATION_SCHEMA.GLOBAL_STATUS 
WHERE VARIABLE_NAME = 'Threads_connected';

-- å¤åˆ¶å»¶è¿Ÿæ£€æµ‹
SHOW SLAVE STATUS\G
-- å½“ Seconds_Behind_Master > 30 æ—¶è§¦å‘éš”ç¦»
```

**éš”ç¦»æ‰§è¡Œæµç¨‹**ï¼š
```
è‡ªåŠ¨éš”ç¦»æµç¨‹ï¼š
æ•…éšœæ£€æµ‹ â†’ å½±å“è¯„ä¼° â†’ éš”ç¦»å†³ç­– â†’ æ‰§è¡Œéš”ç¦» â†’ é€šçŸ¥ç®¡ç†å‘˜

å†³ç­–æ¡ä»¶ï¼š
IF (è¿æ¥å¤±è´¥ç‡ > 90%) OR (å“åº”æ—¶é—´ > 30s) OR (é”™è¯¯ç‡ > 50%)
THEN æ‰§è¡Œè‡ªåŠ¨éš”ç¦»
ELSE ç»§ç»­ç›‘æ§
```

### 3.3 æ•…éšœå½±å“èŒƒå›´æ§åˆ¶


**åˆ†å±‚æ§åˆ¶ç­–ç•¥**ï¼š

| æ§åˆ¶å±‚çº§ | æ§åˆ¶æ–¹æ³• | å½±å“èŒƒå›´ | æ¢å¤éš¾åº¦ |
|----------|----------|----------|----------|
| **åº”ç”¨å±‚** | ç†”æ–­å™¨æ¨¡å¼ | å•ä¸ªåŠŸèƒ½ | å®¹æ˜“ |
| **ä¸­é—´ä»¶** | è¿æ¥æ± éš”ç¦» | å•ä¸ªæœåŠ¡ | ä¸­ç­‰ |
| **æ•°æ®åº“** | èŠ‚ç‚¹éš”ç¦» | æ•´ä¸ªèŠ‚ç‚¹ | å›°éš¾ |
| **ç½‘ç»œå±‚** | æµé‡åˆ‡æ¢ | æ•´ä¸ªé›†ç¾¤ | æœ€éš¾ |

**å®é™…éš”ç¦»é…ç½®ç¤ºä¾‹**ï¼š
```bash
# HAProxyé…ç½® - æ•…éšœèŠ‚ç‚¹è‡ªåŠ¨æ‘˜é™¤
backend mysql_cluster
    option httpchk GET /health
    server mysql1 10.0.1.10:3306 check inter 5s fall 3 rise 2
    server mysql2 10.0.1.11:3306 check inter 5s fall 3 rise 2
    server mysql3 10.0.1.12:3306 check inter 5s fall 3 rise 2
    
# fall 3: è¿ç»­3æ¬¡æ£€æŸ¥å¤±è´¥åæ‘˜é™¤
# rise 2: è¿ç»­2æ¬¡æ£€æŸ¥æˆåŠŸåæ¢å¤
```

---

## 4. ğŸ”„ è‡ªåŠ¨æ•…éšœè½¬ç§»


### 4.1 æ•…éšœè½¬ç§»åŸºæœ¬æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼š
å°±åƒå…¬äº¤è½¦åäº†ï¼Œä¹˜å®¢è¦æ¢ä¹˜å…¶ä»–è½¦è¾†ç»§ç»­è¡Œç¨‹ã€‚æ•°æ®åº“æ•…éšœè½¬ç§»å°±æ˜¯å½“ä¸»æ•°æ®åº“å‡ºé—®é¢˜æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®åº“ï¼Œè®©ç”¨æˆ·æ„Ÿè§‰ä¸åˆ°ä¸­æ–­ã€‚

**è½¬ç§»ç±»å‹å¯¹æ¯”**ï¼š
```
è½¬ç§»æ–¹å¼æ¯”è¾ƒï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ‰‹åŠ¨è½¬ç§»      â”‚   åŠè‡ªåŠ¨è½¬ç§»    â”‚   å…¨è‡ªåŠ¨è½¬ç§»    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äººå·¥å†³ç­–æ‰§è¡Œ    â”‚ è‡ªåŠ¨æ£€æµ‹äººå·¥ç¡®è®¤ â”‚ å…¨ç¨‹è‡ªåŠ¨åŒ–      â”‚
â”‚ é£é™©ä½ä½†æ…¢      â”‚ å¹³è¡¡æ–¹æ¡ˆ        â”‚ å¿«é€Ÿä½†éœ€è°¨æ…    â”‚
â”‚ é€‚åˆæ ¸å¿ƒä¸šåŠ¡    â”‚ é€‚åˆé‡è¦ä¸šåŠ¡    â”‚ é€‚åˆä¸€èˆ¬ä¸šåŠ¡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ•…éšœè½¬ç§»ç­–ç•¥


**è½¬ç§»ä¼˜å…ˆçº§è®¾è®¡**ï¼š
```
èŠ‚ç‚¹é€‰æ‹©ä¼˜å…ˆçº§ï¼š
1. æ•°æ®å®Œæ•´æ€§ > æ€§èƒ½è¡¨ç° > åœ°ç†ä½ç½®
2. åŒæ­¥å»¶è¿Ÿæœ€å°çš„ä»èŠ‚ç‚¹ä¼˜å…ˆ
3. è´Ÿè½½æœ€è½»çš„èŠ‚ç‚¹ä¼˜å…ˆ
4. åŒæœºæˆ¿èŠ‚ç‚¹ä¼˜å…ˆï¼ˆå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼‰
```

**è½¬ç§»å†³ç­–æµç¨‹**ï¼š
```
æ•…éšœè½¬ç§»å†³ç­–æ ‘ï¼š
ä¸»èŠ‚ç‚¹æ•…éšœæ£€æµ‹
    â”œâ”€ æ˜¯å¦æœ‰å¯ç”¨ä»èŠ‚ç‚¹ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ â†’ è¯„ä¼°ä»èŠ‚ç‚¹çŠ¶æ€
    â”‚   â”‚   â”œâ”€ æ•°æ®åŒæ­¥å®Œæ•´ â†’ æ‰§è¡Œè½¬ç§»
    â”‚   â”‚   â””â”€ æ•°æ®æœ‰å»¶è¿Ÿ â†’ ç­‰å¾…åŒæ­¥æˆ–å¼ºåˆ¶è½¬ç§»
    â”‚   â””â”€ å¦ â†’ å°è¯•ä¿®å¤ä¸»èŠ‚ç‚¹æˆ–å¯ç”¨å¤‡ç”¨é›†ç¾¤
    â””â”€ ç½‘ç»œåˆ†åŒºï¼Ÿ â†’ é˜²è„‘è£‚æ£€æŸ¥
```

### 4.3 æœåŠ¡å‘ç°æ›´æ–°æœºåˆ¶


**DNSè‡ªåŠ¨åˆ‡æ¢**ï¼š
```bash
# æ•…éšœå‰
mysql.company.com â†’ 10.0.1.10 (ä¸»èŠ‚ç‚¹)

# æ•…éšœåè‡ªåŠ¨åˆ‡æ¢
mysql.company.com â†’ 10.0.1.11 (æ–°ä¸»èŠ‚ç‚¹)

# TTLè®¾ç½®è¦åˆç†ï¼Œå»ºè®®30-60ç§’
mysql.company.com. 60 IN A 10.0.1.11
```

**åº”ç”¨è¿æ¥æ± æ›´æ–°**ï¼š
```java
// è‡ªåŠ¨æ•…éšœè½¬ç§»çš„è¿æ¥é…ç½®
@Configuration
public class DataSourceConfig {
    
    @Bean
    @Primary
    public DataSource primaryDataSource() {
        HikariConfig config = new HikariConfig();
        // é…ç½®å¤šä¸ªèŠ‚ç‚¹ï¼Œæ”¯æŒè‡ªåŠ¨åˆ‡æ¢
        config.setJdbcUrl("jdbc:mysql://mysql1:3306,mysql2:3306,mysql3:3306/db");
        config.addDataSourceProperty("autoReconnect", "true");
        config.addDataSourceProperty("failOverReadOnly", "false");
        return new HikariDataSource(config);
    }
}
```

---

## 5. ğŸ”§ æ•…éšœæ¢å¤ç­–ç•¥


### 5.1 æ•…éšœæ¢å¤ä¼˜å…ˆçº§


**æ¢å¤ä¼˜å…ˆçº§ç­–ç•¥**ï¼š
```
ä¸šåŠ¡æ¢å¤ä¼˜å…ˆçº§ï¼š
P0: æ ¸å¿ƒæ”¯ä»˜ç³»ç»Ÿ     â† ç«‹å³æ¢å¤ï¼Œå½±å“æ”¶å…¥
P1: ç”¨æˆ·ç™»å½•ç³»ç»Ÿ     â† 30åˆ†é’Ÿå†…ï¼Œå½±å“ä½“éªŒ  
P2: æŠ¥è¡¨æŸ¥è¯¢ç³»ç»Ÿ     â† 2å°æ—¶å†…ï¼Œå½±å“è¿è¥
P3: æ—¥å¿—åˆ†æç³»ç»Ÿ     â† 24å°æ—¶å†…ï¼Œå½±å“åˆ†æ
```

**èµ„æºåˆ†é…ç­–ç•¥**ï¼š
| ä¼˜å…ˆçº§ | äººåŠ›æŠ•å…¥ | èµ„æºåˆ†é… | æ¢å¤ç›®æ ‡ |
|--------|----------|----------|----------|
| P0     | å…¨å‘˜å‚ä¸ | æœ€é«˜ä¼˜å…ˆ | 15åˆ†é’Ÿå†… |
| P1     | æ ¸å¿ƒå›¢é˜Ÿ | é«˜ä¼˜å…ˆçº§ | 1å°æ—¶å†…  |
| P2     | ä¸“äººè´Ÿè´£ | æ­£å¸¸åˆ†é… | 4å°æ—¶å†…  |
| P3     | æ’æœŸå¤„ç† | ç©ºé—²å¤„ç† | 24å°æ—¶å†… |

### 5.2 æ•°æ®å®Œæ•´æ€§æ ¡éªŒæœºåˆ¶


**æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥ä¸»ä»æ•°æ®ä¸€è‡´æ€§
-- åœ¨ä¸»åº“æ‰§è¡Œ
SELECT COUNT(*) as master_count FROM user_orders 
WHERE created_at >= '2025-01-15 00:00:00';

-- åœ¨ä»åº“æ‰§è¡ŒåŒæ ·æŸ¥è¯¢ï¼Œå¯¹æ¯”ç»“æœ
-- å¦‚æœæ•°æ®ä¸ä¸€è‡´ï¼Œéœ€è¦é‡æ–°åŒæ­¥

-- æ£€æŸ¥å…³é”®è¡¨çš„æ ¡éªŒå’Œ
CHECKSUM TABLE user_orders, payment_records;
```

**è‡ªåŠ¨æ•°æ®ä¿®å¤æµç¨‹**ï¼š
```
æ•°æ®ä¿®å¤æµç¨‹ï¼š
1. åœæ­¢æ•…éšœèŠ‚ç‚¹çš„å†™å…¥æ“ä½œ
2. ä»æœ€æ–°çš„å¤‡ä»½å¼€å§‹æ¢å¤
3. åº”ç”¨æ•…éšœæœŸé—´çš„binlog
4. éªŒè¯æ•°æ®å®Œæ•´æ€§
5. é‡æ–°åŠ å…¥é›†ç¾¤
```

### 5.3 æ•…éšœæ¢å¤æµç¨‹


**æ ‡å‡†æ¢å¤æµç¨‹**ï¼š
```
å®Œæ•´æ¢å¤æµç¨‹ï¼š
æ•…éšœå‘ç”Ÿ â†’ å½±å“è¯„ä¼° â†’ ç´§æ€¥æ­¢æŸ â†’ æ ¹å› åˆ†æ â†’ ä¿®å¤æ‰§è¡Œ â†’ éªŒè¯æµ‹è¯• â†’ æœåŠ¡æ¢å¤ â†’ å¤ç›˜æ€»ç»“

æ—¶é—´åˆ†é…ï¼š
- å½±å“è¯„ä¼°: 2åˆ†é’Ÿ
- ç´§æ€¥æ­¢æŸ: 5åˆ†é’Ÿ  
- æ ¹å› åˆ†æ: 15åˆ†é’Ÿï¼ˆå¹¶è¡Œè¿›è¡Œï¼‰
- ä¿®å¤æ‰§è¡Œ: 30åˆ†é’Ÿ
- éªŒè¯æµ‹è¯•: 10åˆ†é’Ÿ
- å¤ç›˜æ€»ç»“: 2å°æ—¶ï¼ˆäº‹åè¿›è¡Œï¼‰
```

**è‡ªé€‚åº”æ¢å¤ç­–ç•¥**ï¼š
```python
# æ™ºèƒ½æ¢å¤ç­–ç•¥é€‰æ‹©
def choose_recovery_strategy(fault_type, data_loss_risk, business_impact):
    if fault_type == "hardware_failure":
        if data_loss_risk == "high":
            return "full_restore_from_backup"
        else:
            return "switch_to_replica"
    
    elif fault_type == "network_partition":
        return "wait_for_network_recovery"
    
    elif fault_type == "software_bug":
        return "restart_with_safe_mode"
    
    # é»˜è®¤ç­–ç•¥
    return "minimal_downtime_recovery"
```

---

## 6. â›“ï¸ çº§è”æ•…éšœé¢„é˜²


### 6.1 çº§è”æ•…éšœçš„å½¢æˆåŸç†


**é€šä¿—è§£é‡Š**ï¼š
å°±åƒå¤šç±³è¯ºéª¨ç‰Œæ•ˆåº”ï¼Œä¸€å¼ ç‰Œå€’ä¸‹ä¼šå¸¦å€’ä¸€æ’ç‰Œã€‚åœ¨æ•°æ®åº“é›†ç¾¤ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹æ•…éšœå¯èƒ½å¯¼è‡´ï¼š
- å…¶ä»–èŠ‚ç‚¹è´Ÿè½½å¢åŠ 
- è¿æ¥æ± è€—å°½
- ç½‘ç»œæ‹¥å¡
- æœ€ç»ˆæ•´ä¸ªç³»ç»Ÿå´©æºƒ

**çº§è”æ•…éšœé“¾æ¡**ï¼š
```
çº§è”æ•…éšœä¼ æ’­è·¯å¾„ï¼š
ä¸»èŠ‚ç‚¹æ•…éšœ â†’ æµé‡è½¬ç§»åˆ°ä»èŠ‚ç‚¹ â†’ ä»èŠ‚ç‚¹è¿‡è½½ â†’ å“åº”å˜æ…¢ â†’ 
è¿æ¥ç§¯å‹ â†’ åº”ç”¨è¶…æ—¶ â†’ é‡è¯•å¢å¤š â†’ é›ªå´©æ•ˆåº” â†’ æ•´ä¸ªç³»ç»Ÿå´©æºƒ
```

### 6.2 è´Ÿè½½å‡è¡¡å™¨æ•…éšœçš„çº§è”å½±å“


**è´Ÿè½½å‡è¡¡å™¨æ•…éšœå½±å“åˆ†æ**ï¼š
```
è´Ÿè½½å‡è¡¡å™¨æ•…éšœå½±å“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è´Ÿè½½å‡è¡¡å™¨æ•…éšœ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â†“ æµé‡åˆ†å‘å¤±æ•ˆ   â”‚ â† æ‰€æœ‰è¯·æ±‚å¯èƒ½æ¶Œå‘å•ä¸ªèŠ‚ç‚¹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â†“ å¥åº·æ£€æŸ¥å¤±æ•ˆ   â”‚ â† æ— æ³•åŠæ—¶å‘ç°èŠ‚ç‚¹æ•…éšœ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â†“ ä¼šè¯ä¿æŒå¤±æ•ˆ   â”‚ â† ç”¨æˆ·ä¼šè¯ä¸¢å¤±
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â†“ æ•´ä½“æœåŠ¡ä¸­æ–­   â”‚ â† å•ç‚¹æ•…éšœå˜ä¸ºå…¨é¢æ•…éšœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é¢„é˜²æªæ–½**ï¼š
```yaml
# å¤šå±‚è´Ÿè½½å‡è¡¡é…ç½®
# ç¬¬ä¸€å±‚ï¼šDNSè½®è¯¢
mysql-east.company.com â†’ LB1 (ä¸»)
mysql-west.company.com â†’ LB2 (å¤‡)

# ç¬¬äºŒå±‚ï¼šç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨
LB1 â†’ HAProxyé›†ç¾¤ (ä¸»å¤‡æ¨¡å¼)

# ç¬¬ä¸‰å±‚ï¼šè½¯ä»¶è´Ÿè½½å‡è¡¡
HAProxy â†’ MySQLèŠ‚ç‚¹æ± 
```

### 6.3 ç†”æ–­ä¸é™æµæœºåˆ¶


**ç†”æ–­å™¨æ¨¡å¼å®ç°**ï¼š
```java
@Component
public class DatabaseCircuitBreaker {
    
    private final AtomicInteger failureCount = new AtomicInteger(0);
    private volatile CircuitState state = CircuitState.CLOSED;
    private long lastFailureTime = 0;
    
    // ç†”æ–­å™¨é…ç½®
    private static final int FAILURE_THRESHOLD = 5;      // å¤±è´¥é˜ˆå€¼
    private static final long TIMEOUT = 60000;           // è¶…æ—¶æ—¶é—´1åˆ†é’Ÿ
    private static final long RETRY_TIMEOUT = 10000;     // é‡è¯•é—´éš”10ç§’
    
    public <T> T execute(Supplier<T> operation, Supplier<T> fallback) {
        if (state == CircuitState.OPEN) {
            if (System.currentTimeMillis() - lastFailureTime > RETRY_TIMEOUT) {
                state = CircuitState.HALF_OPEN; // å°è¯•æ¢å¤
            } else {
                return fallback.get(); // ç›´æ¥è¿”å›é™çº§ç»“æœ
            }
        }
        
        try {
            T result = operation.get();
            onSuccess(); // æˆåŠŸæ—¶é‡ç½®è®¡æ•°å™¨
            return result;
        } catch (Exception e) {
            onFailure(); // å¤±è´¥æ—¶å¢åŠ è®¡æ•°å™¨
            return fallback.get();
        }
    }
    
    private void onSuccess() {
        failureCount.set(0);
        state = CircuitState.CLOSED;
    }
    
    private void onFailure() {
        failureCount.incrementAndGet();
        lastFailureTime = System.currentTimeMillis();
        
        if (failureCount.get() >= FAILURE_THRESHOLD) {
            state = CircuitState.OPEN; // æ‰“å¼€ç†”æ–­å™¨
        }
    }
}
```

**é™æµç­–ç•¥é…ç½®**ï¼š
```sql
-- MySQLè¿æ¥æ•°é™åˆ¶
SET GLOBAL max_connections = 1000;
SET GLOBAL max_user_connections = 50;

-- æŸ¥è¯¢é€Ÿç‡é™åˆ¶ï¼ˆé€šè¿‡åº”ç”¨å±‚å®ç°ï¼‰
-- æ¯ä¸ªç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š100æ¬¡æŸ¥è¯¢
-- æ¯ä¸ªIPæ¯åˆ†é’Ÿæœ€å¤š1000æ¬¡æŸ¥è¯¢
```

---

## 7. ğŸš¨ åº”æ€¥å“åº”ä¸å¤„ç†


### 7.1 ç´§æ€¥æ•…éšœå¤„ç†æµç¨‹


**åº”æ€¥å“åº”ç»„ç»‡æ¶æ„**ï¼š
```
åº”æ€¥å“åº”å›¢é˜Ÿï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº‹ä»¶æŒ‡æŒ¥å®˜    â”‚ â† æ€»ä½“åè°ƒï¼Œå¯¹å¤–æ²Ÿé€š
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æŠ€æœ¯è´Ÿè´£äºº    â”‚ â† æŠ€æœ¯å†³ç­–ï¼Œæ•…éšœå®šä½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è¿ç»´å·¥ç¨‹å¸ˆ    â”‚ â† ç³»ç»Ÿæ“ä½œï¼Œç›‘æ§åˆ†æ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¸šåŠ¡è´Ÿè´£äºº    â”‚ â† ä¸šåŠ¡å½±å“è¯„ä¼°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ²Ÿé€šåè°ƒå‘˜    â”‚ â† å†…å¤–éƒ¨ä¿¡æ¯åŒæ­¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ‡å‡†åº”æ€¥å“åº”æ—¶é—´çº¿**ï¼š
```
T+0åˆ†é’Ÿ: æ•…éšœå‘Šè­¦è§¦å‘
T+2åˆ†é’Ÿ: åº”æ€¥å›¢é˜Ÿé›†ç»“å®Œæˆ
T+5åˆ†é’Ÿ: åˆæ­¥å½±å“è¯„ä¼°å®Œæˆ
T+10åˆ†é’Ÿ: ä¸´æ—¶æ­¢æŸæ–¹æ¡ˆæ‰§è¡Œ
T+30åˆ†é’Ÿ: æ ¹æœ¬æ€§ä¿®å¤æ–¹æ¡ˆæ‰§è¡Œ
T+60åˆ†é’Ÿ: æœåŠ¡å®Œå…¨æ¢å¤
T+24å°æ—¶: æ•…éšœå¤ç›˜ä¼šè®®
```

### 7.2 åº”æ€¥å¤„ç†é¢„æ¡ˆ


**åˆ†çº§å“åº”é¢„æ¡ˆ**ï¼š

| æ•…éšœçº§åˆ« | å“åº”æ—¶é—´ | å‚ä¸äººå‘˜ | å¤„ç†æµç¨‹ |
|----------|----------|----------|----------|
| **L1** | 2åˆ†é’Ÿå†… | è¿ç»´å€¼ç­ | è‡ªåŠ¨å¤„ç†+é€šçŸ¥ |
| **L2** | 5åˆ†é’Ÿå†… | è¿ç»´+æŠ€æœ¯ | æ‰‹åŠ¨ä»‹å…¥å¤„ç† |
| **L3** | 10åˆ†é’Ÿå†… | å…¨æŠ€æœ¯å›¢é˜Ÿ | ç´§æ€¥ä¼šè®®å†³ç­– |
| **L4** | ç«‹å³ | å…¨å…¬å¸ | ç¾éš¾æ¢å¤æµç¨‹ |

**é¢„æ¡ˆæ¨¡æ¿ç¤ºä¾‹**ï¼š
```markdown
# æ•°æ®åº“ä¸»èŠ‚ç‚¹æ•…éšœåº”æ€¥é¢„æ¡ˆ

## æ•…éšœç°è±¡

- æ•°æ®åº“è¿æ¥å¤±è´¥
- åº”ç”¨æŠ¥é”™å¤§é‡å¢åŠ 
- ç›‘æ§æ˜¾ç¤ºä¸»èŠ‚ç‚¹ä¸å¯è¾¾

## ç«‹å³è¡ŒåŠ¨ (5åˆ†é’Ÿå†…)

1. ç¡®è®¤æ•…éšœèŒƒå›´å’Œå½±å“
2. å¯åŠ¨æ•…éšœåˆ‡æ¢æµç¨‹
3. é€šçŸ¥ç›¸å…³å›¢é˜Ÿ
4. å¯ç”¨ä¸´æ—¶é™çº§æªæ–½

## è¯¦ç»†å¤„ç†æ­¥éª¤

1. æ£€æŸ¥ä¸»èŠ‚ç‚¹çŠ¶æ€ï¼š`systemctl status mysql`
2. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼š`ping ä¸»èŠ‚ç‚¹IP`
3. åˆ‡æ¢åˆ°å¤‡èŠ‚ç‚¹ï¼š`promote_slave_to_master.sh`
4. æ›´æ–°DNSè®°å½•ï¼š`update_dns.sh new_master_ip`
5. éªŒè¯æœåŠ¡æ¢å¤ï¼š`health_check.sh`

## å›é€€æ–¹æ¡ˆ

å¦‚æœåˆ‡æ¢å¤±è´¥ï¼Œç«‹å³æ‰§è¡Œï¼š
1. å›æ»šDNSæ›´æ”¹
2. å°è¯•é‡å¯åŸä¸»èŠ‚ç‚¹
3. å¦‚æ— æ³•æ¢å¤ï¼Œå¯ç”¨å®Œå…¨æ‰‹åŠ¨æ¨¡å¼
```

### 7.3 æ•…éšœå¤„ç†è‡ªåŠ¨åŒ–


**è‡ªåŠ¨åŒ–å“åº”è„šæœ¬**ï¼š
```bash
#!/bin/bash
# è‡ªåŠ¨æ•…éšœå¤„ç†è„šæœ¬

# 1. æ•…éšœæ£€æµ‹
check_mysql_health() {
    mysql -h $MYSQL_HOST -u monitor -p$MONITOR_PASSWORD -e "SELECT 1" >/dev/null 2>&1
    return $?
}

# 2. è‡ªåŠ¨åˆ‡æ¢
auto_failover() {
    echo "æ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹æ•…éšœï¼Œå¼€å§‹è‡ªåŠ¨åˆ‡æ¢..."
    
    # æå‡ä»èŠ‚ç‚¹ä¸ºä¸»èŠ‚ç‚¹
    mysql -h $SLAVE_HOST -u admin -p$ADMIN_PASSWORD -e "STOP SLAVE; RESET SLAVE ALL;"
    
    # æ›´æ–°åº”ç”¨é…ç½®
    update_app_config $SLAVE_HOST
    
    # å‘é€é€šçŸ¥
    send_alert "æ•°æ®åº“å·²è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨èŠ‚ç‚¹"
    
    echo "è‡ªåŠ¨åˆ‡æ¢å®Œæˆ"
}

# 3. ä¸»æµç¨‹
main() {
    while true; do
        if ! check_mysql_health; then
            FAILURE_COUNT=$((FAILURE_COUNT + 1))
            
            if [ $FAILURE_COUNT -ge 3 ]; then
                auto_failover
                break
            fi
        else
            FAILURE_COUNT=0
        fi
        
        sleep 30  # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    done
}

main
```

---

## 8. ğŸ›¡ï¸ æ•…éšœé¢„é˜²æªæ–½


### 8.1 é¢„æµ‹æ€§ç»´æŠ¤æœºåˆ¶


**åŸºäºæœºå™¨å­¦ä¹ çš„æ•…éšœé¢„æµ‹**ï¼š
```python
# æ•…éšœé¢„æµ‹æ¨¡å‹ç¤ºä¾‹
import pandas as pd
from sklearn.ensemble import RandomForestClassifier

class DatabaseFailurePredictor:
    def __init__(self):
        self.model = RandomForestClassifier(n_estimators=100)
        self.features = [
            'cpu_usage', 'memory_usage', 'disk_io', 
            'connection_count', 'query_response_time',
            'error_rate', 'slave_lag'
        ]
    
    def predict_failure_risk(self, metrics):
        """
        é¢„æµ‹æœªæ¥1å°æ—¶å†…çš„æ•…éšœé£é™©
        è¿”å›: 0-1ä¹‹é—´çš„é£é™©å€¼ï¼Œ>0.8ä¸ºé«˜é£é™©
        """
        features = [metrics[f] for f in self.features]
        risk_score = self.model.predict_proba([features])[0][1]
        
        if risk_score > 0.8:
            self.alert_high_risk(metrics)
        
        return risk_score
    
    def alert_high_risk(self, metrics):
        """é«˜é£é™©é¢„è­¦"""
        message = f"æ•°æ®åº“æ•…éšœé£é™©é¢„è­¦ï¼å½“å‰æŒ‡æ ‡å¼‚å¸¸ï¼š{metrics}"
        # å‘é€å‘Šè­¦é€šçŸ¥
        send_alert(message, level="WARNING")
```

**é¢„æµ‹ç»´æŠ¤è§¦å‘æ¡ä»¶**ï¼š
```yaml
# é¢„æµ‹æ€§ç»´æŠ¤é…ç½®
predictive_maintenance:
  monitoring_interval: 5m
  prediction_window: 1h
  
  risk_thresholds:
    low: 0.3      # æ­£å¸¸çŠ¶æ€
    medium: 0.6   # å¢åŠ ç›‘æ§é¢‘ç‡
    high: 0.8     # é¢„è­¦å¹¶å‡†å¤‡åº”æ€¥æªæ–½
    critical: 0.9 # ç«‹å³é‡‡å–é¢„é˜²æªæ–½
  
  preventive_actions:
    medium_risk:
      - increase_monitoring_frequency
      - prepare_backup_resources
    high_risk:
      - notify_operations_team
      - start_backup_warm_up
    critical_risk:
      - trigger_planned_failover
      - alert_management
```

### 8.2 æ•…éšœæ³¨å…¥æµ‹è¯•å®è·µ


**Chaos Engineeringå®æ–½**ï¼š
```bash
#!/bin/bash
# æ··æ²Œå·¥ç¨‹æµ‹è¯•è„šæœ¬

# ç½‘ç»œå»¶è¿Ÿæµ‹è¯•
test_network_latency() {
    echo "æµ‹è¯•ç½‘ç»œå»¶è¿Ÿå½±å“..."
    tc qdisc add dev eth0 root netem delay 100ms
    sleep 300  # æŒç»­5åˆ†é’Ÿ
    tc qdisc del dev eth0 root
    echo "ç½‘ç»œå»¶è¿Ÿæµ‹è¯•å®Œæˆ"
}

# CPUå‹åŠ›æµ‹è¯•
test_cpu_stress() {
    echo "æµ‹è¯•CPUå‹åŠ›å½±å“..."
    stress --cpu 8 --timeout 300s
    echo "CPUå‹åŠ›æµ‹è¯•å®Œæˆ"
}

# ç£ç›˜IOæµ‹è¯•
test_disk_io() {
    echo "æµ‹è¯•ç£ç›˜IOå½±å“..."
    dd if=/dev/zero of=/tmp/testfile bs=1M count=1000
    sync
    rm /tmp/testfile
    echo "ç£ç›˜IOæµ‹è¯•å®Œæˆ"
}

# æ•°æ®åº“è¿æ¥æµ‹è¯•
test_connection_limit() {
    echo "æµ‹è¯•è¿æ¥æ•°é™åˆ¶..."
    # æ¨¡æ‹Ÿå¤§é‡è¿æ¥
    for i in {1..100}; do
        mysql -h localhost -u test -p &
    done
    sleep 60
    killall mysql
    echo "è¿æ¥æµ‹è¯•å®Œæˆ"
}
```

**æµ‹è¯•è®¡åˆ’åˆ¶å®š**ï¼š
```markdown
# æœˆåº¦æ··æ²Œå·¥ç¨‹æµ‹è¯•è®¡åˆ’

## ç¬¬1å‘¨ï¼šç½‘ç»œæ•…éšœæ¨¡æ‹Ÿ

- ä¸»ä»ç½‘ç»œä¸­æ–­æµ‹è¯•
- ç½‘ç»œå»¶è¿Ÿå½±å“æµ‹è¯•
- ç½‘ç»œåˆ†åŒºæµ‹è¯•

## ç¬¬2å‘¨ï¼šç¡¬ä»¶æ•…éšœæ¨¡æ‹Ÿ

- CPUé«˜è´Ÿè½½æµ‹è¯•
- å†…å­˜ä¸è¶³æµ‹è¯•
- ç£ç›˜IOå¼‚å¸¸æµ‹è¯•

## ç¬¬3å‘¨ï¼šè½¯ä»¶æ•…éšœæ¨¡æ‹Ÿ

- æ•°æ®åº“è¿›ç¨‹å¼‚å¸¸é€€å‡º
- é…ç½®é”™è¯¯æ¨¡æ‹Ÿ
- æ…¢æŸ¥è¯¢å½±å“æµ‹è¯•

## ç¬¬4å‘¨ï¼šç»¼åˆåœºæ™¯æµ‹è¯•

- å¤šé‡æ•…éšœç»„åˆæµ‹è¯•
- ä¸šåŠ¡é«˜å³°æœŸæ•…éšœæµ‹è¯•
- ç¾éš¾æ¢å¤å…¨æµç¨‹æµ‹è¯•
```

### 8.3 å®šæœŸç»´æŠ¤ç­–ç•¥


**é¢„é˜²æ€§ç»´æŠ¤æ£€æŸ¥æ¸…å•**ï¼š
```markdown
# æ—¥å¸¸ç»´æŠ¤æ£€æŸ¥æ¸…å•

## æ¯æ—¥æ£€æŸ¥ (è‡ªåŠ¨åŒ–)

- [ ] æ•°æ®åº“æœåŠ¡çŠ¶æ€
- [ ] ä¸»ä»å¤åˆ¶çŠ¶æ€
- [ ] ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡
- [ ] æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ
- [ ] å¤‡ä»½ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€

## æ¯å‘¨æ£€æŸ¥ (åŠè‡ªåŠ¨)

- [ ] æ€§èƒ½æŒ‡æ ‡è¶‹åŠ¿åˆ†æ
- [ ] é”™è¯¯æ—¥å¿—è¯¦ç»†åˆ†æ
- [ ] ç”¨æˆ·æƒé™å®¡è®¡
- [ ] é…ç½®å˜æ›´å›é¡¾
- [ ] å®¹é‡è§„åˆ’è¯„ä¼°

## æ¯æœˆæ£€æŸ¥ (æ‰‹åŠ¨)

- [ ] ç¡¬ä»¶å¥åº·çŠ¶æ€æ£€æŸ¥
- [ ] å®‰å…¨è¡¥ä¸æ›´æ–°è¯„ä¼°
- [ ] å¤‡ä»½æ¢å¤æµ‹è¯•
- [ ] ç¾éš¾æ¢å¤æ¼”ç»ƒ
- [ ] æ€§èƒ½ä¼˜åŒ–æœºä¼šè¯†åˆ«
```

---

## 9. ğŸ¤– æ™ºèƒ½åŒ–æ•…éšœç®¡ç†


### 9.1 æ™ºèƒ½æ ¹å› åˆ†æ


**è‡ªåŠ¨æ ¹å› åˆ†æç³»ç»Ÿ**ï¼š
```python
class IntelligentRootCauseAnalyzer:
    def __init__(self):
        self.knowledge_base = {
            'high_cpu': ['slow_queries', 'too_many_connections', 'index_missing'],
            'high_memory': ['query_cache_size', 'buffer_pool_size', 'connection_leak'],
            'high_disk_io': ['table_scan', 'index_rebuild', 'log_writing'],
            'connection_timeout': ['network_issue', 'firewall_block', 'dns_resolution']
        }
    
    def analyze_symptoms(self, metrics, logs):
        """
        åŸºäºç—‡çŠ¶åˆ†æå¯èƒ½çš„æ ¹æœ¬åŸå› 
        """
        symptoms = self.extract_symptoms(metrics)
        potential_causes = []
        
        for symptom in symptoms:
            if symptom in self.knowledge_base:
                potential_causes.extend(self.knowledge_base[symptom])
        
        # åŸºäºæ—¥å¿—è¿›ä¸€æ­¥åˆ†æ
        log_analysis = self.analyze_logs(logs)
        
        # ç»¼åˆåˆ¤æ–­æœ€å¯èƒ½çš„åŸå› 
        root_cause = self.rank_causes(potential_causes, log_analysis)
        
        return root_cause
    
    def generate_solution(self, root_cause):
        """
        åŸºäºæ ¹å› ç”Ÿæˆè§£å†³æ–¹æ¡ˆ
        """
        solutions = {
            'slow_queries': [
                'åˆ†æå¹¶ä¼˜åŒ–æ…¢æŸ¥è¯¢',
                'æ·»åŠ åˆé€‚çš„ç´¢å¼•',
                'è€ƒè™‘æŸ¥è¯¢é‡å†™'
            ],
            'too_many_connections': [
                'æ£€æŸ¥è¿æ¥æ± é…ç½®',
                'æŸ¥æ‰¾è¿æ¥æ³„æ¼',
                'è°ƒæ•´max_connectionså‚æ•°'
            ],
            # ... æ›´å¤šè§£å†³æ–¹æ¡ˆ
        }
        
        return solutions.get(root_cause, ['éœ€è¦äººå·¥åˆ†æ'])
```

### 9.2 è‡ªé€‚åº”æ•…éšœæ¢å¤


**æ™ºèƒ½æ¢å¤ç­–ç•¥é€‰æ‹©**ï¼š
```python
class AdaptiveRecoverySystem:
    def __init__(self):
        self.recovery_strategies = {
            'fast_recovery': {'time': 5, 'risk': 'medium', 'data_loss': 'possible'},
            'safe_recovery': {'time': 30, 'risk': 'low', 'data_loss': 'none'},
            'hybrid_recovery': {'time': 15, 'risk': 'low', 'data_loss': 'minimal'}
        }
    
    def choose_strategy(self, business_context, failure_context):
        """
        åŸºäºä¸šåŠ¡å’Œæ•…éšœä¸Šä¸‹æ–‡é€‰æ‹©æœ€ä¼˜æ¢å¤ç­–ç•¥
        """
        # ä¸šåŠ¡å…³é”®åº¦è¯„ä¼°
        if business_context['is_peak_hour'] and business_context['business_critical']:
            if failure_context['data_corruption_risk'] == 'low':
                return 'fast_recovery'
            else:
                return 'hybrid_recovery'
        
        # éå…³é”®æ—¶æœŸï¼Œä¼˜å…ˆå®‰å…¨
        return 'safe_recovery'
    
    def execute_recovery(self, strategy, failure_details):
        """
        æ‰§è¡Œé€‰å®šçš„æ¢å¤ç­–ç•¥
        """
        plan = self.recovery_strategies[strategy]
        
        # åŠ¨æ€è°ƒæ•´æ¢å¤æ­¥éª¤
        steps = self.generate_recovery_steps(strategy, failure_details)
        
        for step in steps:
            result = self.execute_step(step)
            if not result.success:
                # åŠ¨æ€è°ƒæ•´ç­–ç•¥
                strategy = self.fallback_strategy(strategy)
                steps = self.generate_recovery_steps(strategy, failure_details)
        
        return result
```

### 9.3 å†³ç­–è‡ªåŠ¨åŒ–ä¸äººå·¥å¹²é¢„å¹³è¡¡


**æ™ºèƒ½å†³ç­–ç³»ç»Ÿ**ï¼š
```yaml
# è‡ªåŠ¨åŒ–å†³ç­–è§„åˆ™é…ç½®
decision_rules:
  # å®Œå…¨è‡ªåŠ¨åŒ–åœºæ™¯
  full_automation:
    conditions:
      - failure_type: "network_timeout"
      - confidence_level: "> 0.95"
      - business_impact: "< medium"
    actions:
      - auto_retry
      - auto_failover
      - notify_team
  
  # åŠè‡ªåŠ¨åŒ–åœºæ™¯
  human_approval:
    conditions:
      - failure_type: "data_corruption"
      - confidence_level: "> 0.8"
      - business_impact: ">= medium"
    actions:
      - analyze_impact
      - prepare_solution
      - request_approval
      - execute_with_monitoring
  
  # å®Œå…¨äººå·¥å¤„ç†
  manual_intervention:
    conditions:
      - confidence_level: "< 0.8"
      - business_impact: "critical"
      - data_loss_risk: "high"
    actions:
      - immediate_alert
      - assemble_expert_team
      - manual_analysis_required
```

**äººæœºåä½œæµç¨‹**ï¼š
```
æ™ºèƒ½åŒ–æ•…éšœå¤„ç†æµç¨‹ï¼š
æ•…éšœæ£€æµ‹(AI) â†’ å½±å“è¯„ä¼°(AI) â†’ åˆæ­¥åˆ†æ(AI) â†’ å†³ç­–ç‚¹(AI+äººå·¥) â†’ æ‰§è¡Œ(AIç›‘ç£) â†’ éªŒè¯(äººå·¥)

å†³ç­–ç‚¹è§„åˆ™ï¼š
- é«˜ç½®ä¿¡åº¦ + ä½é£é™© = è‡ªåŠ¨æ‰§è¡Œ
- ä¸­ç½®ä¿¡åº¦ + ä¸­é£é™© = äººå·¥ç¡®è®¤åæ‰§è¡Œ  
- ä½ç½®ä¿¡åº¦ + é«˜é£é™© = å®Œå…¨äººå·¥å¤„ç†
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•…éšœå¤„ç†å››è¦ç´ ï¼šæ£€æµ‹ã€éš”ç¦»ã€è½¬ç§»ã€æ¢å¤
ğŸ”¸ æ•…éšœå½±å“æ§åˆ¶ï¼šå¿«é€Ÿæ­¢æŸæ¯”å®Œç¾ä¿®å¤æ›´é‡è¦
ğŸ”¸ çº§è”æ•…éšœé¢„é˜²ï¼šä¸€ä¸ªèŠ‚ç‚¹æ•…éšœä¸èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ
ğŸ”¸ è‡ªåŠ¨åŒ–å¹³è¡¡ï¼šå…³é”®å†³ç­–éœ€è¦äººå·¥ç¡®è®¤ï¼Œæ—¥å¸¸æ“ä½œå¯ä»¥è‡ªåŠ¨åŒ–
ğŸ”¸ é¢„é˜²æ€§ç»´æŠ¤ï¼šé¢„é˜²æ•…éšœæ¯”åº”å¯¹æ•…éšœæ›´æœ‰ä»·å€¼
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ•…éšœå¤„ç†çš„æœ¬è´¨æ˜¯é£é™©ç®¡ç†**
```
é£é™©è¯„ä¼°ç»´åº¦ï¼š
â€¢ æ•…éšœå½±å“èŒƒå›´ - å½±å“å¤šå°‘ç”¨æˆ·
â€¢ ä¸šåŠ¡æŸå¤±ç¨‹åº¦ - é€ æˆå¤šå¤§æŸå¤±  
â€¢ æ¢å¤æ—¶é—´é¢„æœŸ - éœ€è¦å¤šé•¿æ—¶é—´
â€¢ æ•°æ®ä¸¢å¤±é£é™© - æ˜¯å¦ä¼šä¸¢å¤±æ•°æ®
```

**ğŸ”¹ è‡ªåŠ¨åŒ–ä¸äººå·¥çš„å¹³è¡¡åŸåˆ™**
```
è‡ªåŠ¨åŒ–é€‚ç”¨åœºæ™¯ï¼š
â€¢ æ•…éšœæ¨¡å¼æ˜ç¡®ä¸”å¸¸è§
â€¢ å¤„ç†æ­¥éª¤æ ‡å‡†åŒ–
â€¢ å¤±è´¥æˆæœ¬å¯æ§

äººå·¥å¹²é¢„å¿…è¦åœºæ™¯ï¼š
â€¢ æ•…éšœæ¨¡å¼å¤æ‚æˆ–ç½•è§
â€¢ æ¶‰åŠæ•°æ®å®Œæ•´æ€§é£é™©
â€¢ ä¸šåŠ¡å½±å“å·¨å¤§
```

**ğŸ”¹ æ•…éšœå¤„ç†çš„æ—¶é—´çª—å£ç®¡ç†**
```
é»„é‡‘æ—¶é—´åˆ†é…ï¼š
å‰5åˆ†é’Ÿï¼šå¿«é€Ÿæ­¢æŸï¼Œé˜²æ­¢æ‰©æ•£
å‰30åˆ†é’Ÿï¼šä¸´æ—¶ä¿®å¤ï¼Œæ¢å¤æœåŠ¡
åç»­æ—¶é—´ï¼šæ ¹æœ¬ä¿®å¤ï¼Œé˜²æ­¢é‡å¤
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ› ï¸ æ•…éšœå¤„ç†æœ€ä½³å®è·µ**ï¼š
- **å»ºç«‹æ ‡å‡†æµç¨‹**ï¼šæ¯ç§æ•…éšœç±»å‹éƒ½æœ‰æ ‡å‡†å¤„ç†æµç¨‹
- **å®šæœŸæ¼”ç»ƒ**ï¼šé€šè¿‡æ•…éšœæ¼”ç»ƒéªŒè¯åº”æ€¥é¢„æ¡ˆçš„æœ‰æ•ˆæ€§
- **æŒç»­æ”¹è¿›**ï¼šæ¯æ¬¡æ•…éšœåéƒ½è¦åšå¤ç›˜å’Œæ”¹è¿›
- **å·¥å…·è‡ªåŠ¨åŒ–**ï¼šå°†é‡å¤æ€§æ“ä½œè‡ªåŠ¨åŒ–ï¼Œå‡å°‘äººä¸ºé”™è¯¯

**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
```yaml
æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼š
å¯ç”¨æ€§æŒ‡æ ‡:
  - æœåŠ¡å¯ç”¨ç‡: 99.99%
  - æ•…éšœæ¢å¤æ—¶é—´: MTTR < 15åˆ†é’Ÿ
  - æ•…éšœé—´éš”æ—¶é—´: MTBF > 30å¤©

æ€§èƒ½æŒ‡æ ‡:
  - å“åº”æ—¶é—´: < 100ms
  - ååé‡: > 1000 QPS
  - é”™è¯¯ç‡: < 0.1%

ä¸šåŠ¡æŒ‡æ ‡:
  - ç”¨æˆ·å½±å“æ•°é‡
  - ä¸šåŠ¡æŸå¤±é‡‘é¢
  - æœåŠ¡é™çº§æ—¶é•¿
```

### 10.4 æ•…éšœå¤„ç†æˆç†Ÿåº¦æ¨¡å‹


```
Level 1 - è¢«åŠ¨å“åº”ï¼š
â€¢ æ•…éšœå‘ç”Ÿåæ‰å¤„ç†
â€¢ ä¸»è¦ä¾é äººå·¥æ“ä½œ
â€¢ æ¢å¤æ—¶é—´è¾ƒé•¿

Level 2 - ä¸»åŠ¨ç›‘æ§ï¼š
â€¢ å»ºç«‹ç›‘æ§å‘Šè­¦ä½“ç³»
â€¢ éƒ¨åˆ†æµç¨‹è‡ªåŠ¨åŒ–
â€¢ æœ‰åŸºæœ¬çš„åº”æ€¥é¢„æ¡ˆ

Level 3 - é¢„æµ‹é¢„é˜²ï¼š
â€¢ æ•…éšœé¢„æµ‹èƒ½åŠ›
â€¢ å¤§éƒ¨åˆ†æ“ä½œè‡ªåŠ¨åŒ–
â€¢ å®Œå–„çš„æ¼”ç»ƒä½“ç³»

Level 4 - è‡ªæ„ˆç³»ç»Ÿï¼š
â€¢ æ™ºèƒ½æ•…éšœå¤„ç†
â€¢ è‡ªé€‚åº”æ¢å¤ç­–ç•¥
â€¢ æŒç»­ä¼˜åŒ–æ”¹è¿›

Level 5 - æ··æ²Œå·¥ç¨‹ï¼š
â€¢ ä¸»åŠ¨æ•…éšœæ³¨å…¥
â€¢ åè„†å¼±æ€§è®¾è®¡
â€¢ æè‡´çš„å¯ç”¨æ€§
```

**ğŸ¯ å‘å±•è·¯å¾„å»ºè®®**ï¼š
1. **åŸºç¡€é˜¶æ®µ**ï¼šå»ºç«‹åŸºæœ¬çš„ç›‘æ§å’Œå‘Šè­¦
2. **æå‡é˜¶æ®µ**ï¼šåˆ¶å®šæ ‡å‡†åŒ–çš„åº”æ€¥æµç¨‹
3. **ä¼˜åŒ–é˜¶æ®µ**ï¼šå¼•å…¥è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–å·¥å…·
4. **é«˜çº§é˜¶æ®µ**ï¼šå»ºè®¾è‡ªæ„ˆèƒ½åŠ›å’Œé¢„æµ‹èƒ½åŠ›

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ•…éšœå¤„ç†é‡åœ¨å¿«ï¼Œæ£€æµ‹éš”ç¦»è½¬ç§»æ¢å¤è¦åˆ†æ˜
- é¢„é˜²èƒœè¿‡æ²»ç–—ï¼Œç›‘æ§é¢„è­¦ä¸å¯å°‘
- è‡ªåŠ¨äººå·¥ç›¸ç»“åˆï¼Œå…³é”®å†³ç­–éœ€è°¨æ…
- æ¼”ç»ƒå¤ç›˜å¸¸æ€åŒ–ï¼ŒæŒç»­æ”¹è¿›æ˜¯ç‹é“