---
title: 20ã€å¤åˆ¶ä¸Žå­˜å‚¨å¼•æ“Žäº¤äº’
---
## ðŸ“š ç›®å½•

1. [å¤åˆ¶ä¸Žå­˜å‚¨å¼•æ“ŽåŸºç¡€æ¦‚å¿µ](#1-å¤åˆ¶ä¸Žå­˜å‚¨å¼•æ“ŽåŸºç¡€æ¦‚å¿µ)
2. [InnoDBä¸Žå¤åˆ¶åä½œæœºåˆ¶](#2-InnoDBä¸Žå¤åˆ¶åä½œæœºåˆ¶)
3. [äº‹åŠ¡æ—¥å¿—ä¸ŽBinlogåŒæ­¥](#3-äº‹åŠ¡æ—¥å¿—ä¸ŽBinlogåŒæ­¥)
4. [å­˜å‚¨å¼•æ“Žæäº¤é’©å­](#4-å­˜å‚¨å¼•æ“Žæäº¤é’©å­)
5. [å´©æºƒæ¢å¤åè°ƒæœºåˆ¶](#5-å´©æºƒæ¢å¤åè°ƒæœºåˆ¶)
6. [é”ä¸Žå¤åˆ¶çš„äº¤äº’](#6-é”ä¸Žå¤åˆ¶çš„äº¤äº’)
7. [å­˜å‚¨å¼•æ“Žåˆ‡æ¢å¯¹å¤åˆ¶çš„å½±å“](#7-å­˜å‚¨å¼•æ“Žåˆ‡æ¢å¯¹å¤åˆ¶çš„å½±å“)
8. [å¤šå¼•æ“ŽçŽ¯å¢ƒå¤åˆ¶å¤„ç†](#8-å¤šå¼•æ“ŽçŽ¯å¢ƒå¤åˆ¶å¤„ç†)
9. [å¼•æ“Žç‰¹æ€§å¯¹å¤åˆ¶çš„å½±å“](#9-å¼•æ“Žç‰¹æ€§å¯¹å¤åˆ¶çš„å½±å“)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ”„ å¤åˆ¶ä¸Žå­˜å‚¨å¼•æ“ŽåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¤åˆ¶ä¸Žå­˜å‚¨å¼•æ“Žäº¤äº’


MySQLå¤åˆ¶ä¸Žå­˜å‚¨å¼•æ“Žäº¤äº’æŒ‡çš„æ˜¯**MySQLä¸»ä»Žå¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œå¤åˆ¶ç³»ç»Ÿå¦‚ä½•ä¸Žä¸åŒå­˜å‚¨å¼•æ“Žåè°ƒå·¥ä½œ**çš„æœºåˆ¶ã€‚ç®€å•è¯´å°±æ˜¯å¤åˆ¶åŠŸèƒ½è¦å’Œå­˜å‚¨å¼•æ“Ž"é…åˆ"ï¼Œç¡®ä¿æ•°æ®æ­£ç¡®åŒæ­¥ã€‚

```
åŸºæœ¬äº¤äº’æµç¨‹ï¼š
åº”ç”¨ç¨‹åº â†’ MySQLæœåŠ¡å™¨ â†’ å­˜å‚¨å¼•æ“Ž â†’ æ•°æ®æ–‡ä»¶
    â†“
å¤åˆ¶ç³»ç»Ÿç›‘å¬å˜æ›´ â†’ å†™å…¥Binlog â†’ ä¼ è¾“åˆ°ä»Žåº“
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦äº¤äº’åè°ƒ


**æ ¸å¿ƒé—®é¢˜**ï¼šä¸åŒå­˜å‚¨å¼•æ“Žæœ‰ä¸åŒç‰¹æ€§ï¼Œå¤åˆ¶ç³»ç»Ÿå¿…é¡»é€‚åº”è¿™äº›å·®å¼‚

```
InnoDBç‰¹ç‚¹ï¼š           MyISAMç‰¹ç‚¹ï¼š           Memoryç‰¹ç‚¹ï¼š
âœ“ æ”¯æŒäº‹åŠ¡             âœ— ä¸æ”¯æŒäº‹åŠ¡           âœ— ä¸æ”¯æŒäº‹åŠ¡  
âœ“ æ”¯æŒå¤–é”®             âœ— ä¸æ”¯æŒå¤–é”®           âœ— ä¸æ”¯æŒå¤–é”®
âœ“ è¡Œçº§é”               âœ— è¡¨çº§é”               âœ“ è¡Œçº§é”
âœ“ å´©æºƒæ¢å¤             âœ— æ— å´©æºƒæ¢å¤           âœ— æ•°æ®æ˜“ä¸¢å¤±
```

**å®žé™…å½±å“**ï¼š
- **äº‹åŠ¡æ€§å¼•æ“Ž**ï¼šéœ€è¦ä¿è¯äº‹åŠ¡å®Œæ•´æ€§
- **éžäº‹åŠ¡å¼•æ“Ž**ï¼šæ¯æ¡è¯­å¥ç«‹å³ç”Ÿæ•ˆ
- **å¤åˆ¶ç³»ç»Ÿ**ï¼šå¿…é¡»æ­£ç¡®å¤„ç†è¿™äº›å·®å¼‚

---

## 2. ðŸ—ï¸ InnoDBä¸Žå¤åˆ¶åä½œæœºåˆ¶


### 2.1 InnoDBäº‹åŠ¡ä¸Žå¤åˆ¶çš„åä½œ


InnoDBä½œä¸ºMySQLé»˜è®¤å­˜å‚¨å¼•æ“Žï¼Œä¸Žå¤åˆ¶ç³»ç»Ÿæœ‰ç€**æ·±åº¦é›†æˆ**çš„åä½œå…³ç³»ã€‚

**åä½œè¿‡ç¨‹å›¾ç¤º**ï¼š
```
äº‹åŠ¡å¼€å§‹ â†’ æ‰§è¡ŒSQL â†’ å‡†å¤‡æäº¤ â†’ å†™Binlog â†’ å­˜å‚¨å¼•æ“Žæäº¤
   â†“          â†“         â†“          â†“          â†“
BEGIN     ä¿®æ”¹æ•°æ®    2PCå‡†å¤‡    è®°å½•å˜æ›´    çœŸæ­£æäº¤
```

### 2.2 ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆ2PCï¼‰


**ä»€ä¹ˆæ˜¯ä¸¤é˜¶æ®µæäº¤**ï¼šç¡®ä¿InnoDBäº‹åŠ¡æ—¥å¿—å’ŒBinlogä¿æŒä¸€è‡´çš„æœºåˆ¶

```
é˜¶æ®µä¸€ï¼šå‡†å¤‡é˜¶æ®µï¼ˆPrepareï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å†™å…¥Redo Log â”‚ â† InnoDBå‡†å¤‡æäº¤
â”‚ 2. æ ‡è®°ä¸ºPrepareâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
é˜¶æ®µäºŒï¼šæäº¤é˜¶æ®µï¼ˆCommitï¼‰  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å†™å…¥Binlog   â”‚ â† å¤åˆ¶ç³»ç»Ÿè®°å½•
â”‚ 2. æäº¤äº‹åŠ¡     â”‚ â† InnoDBæœ€ç»ˆæäº¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 åä½œçš„æ ¸å¿ƒä»·å€¼


**ä¿è¯æ•°æ®ä¸€è‡´æ€§**ï¼š
- **InnoDBå†…éƒ¨ä¸€è‡´**ï¼šäº‹åŠ¡ACIDç‰¹æ€§
- **ä¸»ä»Žæ•°æ®ä¸€è‡´**ï¼šBinlogæ­£ç¡®è®°å½•
- **å´©æºƒåŽæ¢å¤ä¸€è‡´**ï¼šä¸¤ä¸ªæ—¥å¿—åè°ƒæ¢å¤

```sql
-- ç¤ºä¾‹ï¼šä¸€ä¸ªè½¬è´¦äº‹åŠ¡
START TRANSACTION;
UPDATE account SET balance = balance - 100 WHERE id = 1;
UPDATE account SET balance = balance + 100 WHERE id = 2;
COMMIT;
-- è¿™ä¸ªäº‹åŠ¡è¦ä¹ˆå®Œå…¨æˆåŠŸå¤åˆ¶ï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥
```

---

## 3. ðŸ“ äº‹åŠ¡æ—¥å¿—ä¸ŽBinlogåŒæ­¥


### 3.1 åŒæ—¥å¿—ç³»ç»Ÿçš„å¿…è¦æ€§


MySQLä½¿ç”¨**åŒæ—¥å¿—ç³»ç»Ÿ**æ¥æ»¡è¶³ä¸åŒéœ€æ±‚ï¼š

| æ—¥å¿—ç±»åž‹ | **ä½œç”¨** | **ä½ç½®** | **æ ¼å¼** | **ç”¨é€”** |
|---------|---------|---------|---------|---------|
| **Redo Log** | `InnoDBå´©æºƒæ¢å¤` | `å­˜å‚¨å¼•æ“Žå±‚` | `ç‰©ç†æ—¥å¿—` | `æœ¬åœ°æ¢å¤` |
| **Binlog** | `ä¸»ä»Žå¤åˆ¶è®°å½•` | `MySQLæœåŠ¡å±‚` | `é€»è¾‘æ—¥å¿—` | `å¤åˆ¶&å¤‡ä»½` |

### 3.2 åŒæ­¥è¿‡ç¨‹è¯¦è§£


**å…·ä½“åŒæ­¥æµç¨‹**ï¼š

```
æ‰§è¡Œäº‹åŠ¡çš„åŒæ­¥è¿‡ç¨‹ï¼š

å®¢æˆ·ç«¯æ‰§è¡Œï¼šUPDATE user SET name='å¼ ä¸‰' WHERE id=1;

ç¬¬1æ­¥ï¼šInnoDBå¤„ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é”å®šç›¸å…³è¡Œ            â”‚
â”‚ 2. ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®é¡µ    â”‚  
â”‚ 3. å†™å…¥Undo Log         â”‚
â”‚ 4. å†™å…¥Redo Log(prepare)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬2æ­¥ï¼šMySQLæœåŠ¡å±‚å¤„ç†  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”ŸæˆBinlogäº‹ä»¶        â”‚
â”‚ 2. å†™å…¥Binlogæ–‡ä»¶        â”‚
â”‚ 3. è°ƒç”¨å­˜å‚¨å¼•æ“Žæäº¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬3æ­¥ï¼šInnoDBæœ€ç»ˆæäº¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ ‡è®°Redo Logä¸ºcommit  â”‚
â”‚ 2. é‡Šæ”¾é”èµ„æº            â”‚
â”‚ 3. è¿”å›žæäº¤æˆåŠŸ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 åŒæ­¥çš„å…³é”®é…ç½®


**é‡è¦å‚æ•°è®¾ç½®**ï¼š

```sql
-- ç¡®ä¿Binlogå’ŒInnoDBåŒæ­¥
SET GLOBAL sync_binlog = 1;           -- æ¯æ¬¡æäº¤éƒ½åˆ·æ–°Binlog
SET GLOBAL innodb_flush_log_at_trx_commit = 1;  -- æ¯æ¬¡æäº¤éƒ½åˆ·æ–°Redo Log

-- æŸ¥çœ‹å½“å‰è®¾ç½®
SHOW VARIABLES LIKE 'sync_binlog';
SHOW VARIABLES LIKE 'innodb_flush_log_at_trx_commit';
```

---

## 4. ðŸ”— å­˜å‚¨å¼•æ“Žæäº¤é’©å­


### 4.1 ä»€ä¹ˆæ˜¯æäº¤é’©å­


**æäº¤é’©å­**å°±æ˜¯å­˜å‚¨å¼•æ“Žåœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œ**ä¸»åŠ¨é€šçŸ¥MySQLå¤åˆ¶ç³»ç»Ÿ**çš„æœºåˆ¶ã€‚å°±åƒ"äº‹åŠ¡æäº¤äº†ï¼Œå¿«è®°å½•åˆ°Binlog"çš„é€šçŸ¥ã€‚

### 4.2 é’©å­æœºåˆ¶åŽŸç†


```
æäº¤é’©å­å·¥ä½œæµç¨‹ï¼š

åº”ç”¨å±‚äº‹åŠ¡                å­˜å‚¨å¼•æ“Ž                å¤åˆ¶ç³»ç»Ÿ
    |                       |                       |
    |---[1]COMMIT---------->|                       |
    |                       |---[2]å‡†å¤‡æäº¤-------->|
    |                       |<--[3]è®°å½•Binlog-------|
    |                       |---[4]æœ€ç»ˆæäº¤-------->|
    |<--[5]è¿”å›žæˆåŠŸ----------|<--[5]æäº¤å®Œæˆ---------|
```

### 4.3 é’©å­çš„æ ¸å¿ƒä½œç”¨


**ç¡®ä¿åŽŸå­æ€§**ï¼š
- è¦ä¹ˆäº‹åŠ¡å’ŒBinlogéƒ½æˆåŠŸ
- è¦ä¹ˆéƒ½å¤±è´¥å›žæ»š
- ç»ä¸å…è®¸ä¸ä¸€è‡´çŠ¶æ€

```sql
-- ä¾‹å¦‚ï¼šæ‰¹é‡æ’å…¥æ“ä½œ
BEGIN;
INSERT INTO orders (user_id, amount) VALUES (1, 100);
INSERT INTO orders (user_id, amount) VALUES (2, 200);
INSERT INTO orders (user_id, amount) VALUES (3, 300);
COMMIT;
-- æäº¤é’©å­ç¡®ä¿ï¼šè¦ä¹ˆ3æ¡è®°å½•éƒ½å¤åˆ¶ï¼Œè¦ä¹ˆéƒ½ä¸å¤åˆ¶
```

### 4.4 ä¸åŒå¼•æ“Žçš„é’©å­å·®å¼‚


| å­˜å‚¨å¼•æ“Ž | **é’©å­æ”¯æŒ** | **äº‹åŠ¡ç‰¹æ€§** | **å¤åˆ¶è¡¨çŽ°** |
|---------|-------------|-------------|-------------|
| **InnoDB** | `å®Œæ•´æ”¯æŒ` | `ACIDäº‹åŠ¡` | `äº‹åŠ¡çº§å¤åˆ¶` |
| **MyISAM** | `è¯­å¥çº§æ”¯æŒ` | `æ— äº‹åŠ¡` | `è¯­å¥çº§å¤åˆ¶` |
| **Memory** | `åŸºç¡€æ”¯æŒ` | `æ— äº‹åŠ¡` | `è¯­å¥çº§å¤åˆ¶` |

---

## 5. ðŸ”§ å´©æºƒæ¢å¤åè°ƒæœºåˆ¶


### 5.1 å´©æºƒæ¢å¤çš„æŒ‘æˆ˜


å½“MySQLæœåŠ¡å™¨**æ„å¤–å´©æºƒ**æ—¶ï¼Œéœ€è¦ç¡®ä¿ï¼š
- **InnoDBæ•°æ®**ï¼šé€šè¿‡Redo Logæ¢å¤
- **Binlogæ•°æ®**ï¼šä¿æŒä¸ŽInnoDBä¸€è‡´
- **ä¸»ä»Žå¤åˆ¶**ï¼šä¸å‡ºçŽ°æ•°æ®ä¸ä¸€è‡´

### 5.2 æ¢å¤åè°ƒæµç¨‹


```
MySQLå¯åŠ¨æ—¶çš„æ¢å¤è¿‡ç¨‹ï¼š

ç¬¬1æ­¥ï¼šæ£€æŸ¥Redo LogçŠ¶æ€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰«æRedo Logæ–‡ä»¶        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚TXN1 â”‚TXN2 â”‚TXN3 â”‚    â”‚ 
â”‚ â”‚COMM â”‚PREP â”‚COMM â”‚    â”‚ â† è¯†åˆ«äº‹åŠ¡çŠ¶æ€
â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬2æ­¥ï¼šå¯¹æ¯”Binlogè®°å½•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥Binlogä¸­çš„äº‹åŠ¡è®°å½•  â”‚
â”‚ TXN1: âœ“ å·²è®°å½•          â”‚
â”‚ TXN2: âœ— æœªè®°å½•          â”‚ â† éœ€è¦å†³ç­–
â”‚ TXN3: âœ“ å·²è®°å½•          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬3æ­¥ï¼šåè°ƒå†³ç­–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TXN1: ä¿æŒæäº¤çŠ¶æ€      â”‚
â”‚ TXN2: å›žæ»šäº‹åŠ¡          â”‚ â† å› ä¸ºBinlogæ²¡è®°å½•
â”‚ TXN3: ä¿æŒæäº¤çŠ¶æ€      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 åè°ƒç­–ç•¥


**æ¢å¤åŽŸåˆ™**ï¼šä»¥Binlogä¸ºå‡†è¿›è¡Œåè°ƒ

```sql
-- æ¢å¤æ—¶çš„åˆ¤æ–­é€»è¾‘
IF (äº‹åŠ¡åœ¨Redo Logä¸­æ˜¯PREPAREçŠ¶æ€) THEN
    IF (äº‹åŠ¡åœ¨Binlogä¸­æœ‰è®°å½•) THEN
        æäº¤è¯¥äº‹åŠ¡;  -- å¤åˆ¶å·²ç»è®°å½•ï¼Œéœ€è¦ä¿æŒä¸€è‡´
    ELSE
        å›žæ»šè¯¥äº‹åŠ¡;  -- å¤åˆ¶æœªè®°å½•ï¼Œåº”è¯¥å›žæ»š
    END IF;
END IF;
```

---

## 6. ðŸ”’ é”ä¸Žå¤åˆ¶çš„äº¤äº’


### 6.1 é”æœºåˆ¶å¯¹å¤åˆ¶çš„å½±å“


ä¸åŒå­˜å‚¨å¼•æ“Žçš„**é”ç‰¹æ€§**ç›´æŽ¥å½±å“å¤åˆ¶çš„è¡¨çŽ°ï¼š

### 6.2 InnoDBè¡Œçº§é”ä¸Žå¤åˆ¶


**è¡Œçº§é”çš„ä¼˜åŠ¿**ï¼šæ›´å¥½çš„å¹¶å‘æ€§èƒ½

```
å¹¶å‘äº‹åŠ¡ç¤ºä¾‹ï¼š

äº‹åŠ¡Aï¼šUPDATE user SET age=25 WHERE id=1;  â† é”å®šid=1è¡Œ
äº‹åŠ¡Bï¼šUPDATE user SET age=30 WHERE id=2;  â† é”å®šid=2è¡Œ

å¤åˆ¶è¡¨çŽ°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥å¹¶å‘ â”‚ â† ä¸åŒè¡Œï¼Œä¸å†²çª
â”‚ å¤åˆ¶æ—¶é¡ºåºæ‰§è¡Œ   â”‚ â† ä¿è¯æ•°æ®ä¸€è‡´
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 MyISAMè¡¨çº§é”ä¸Žå¤åˆ¶


**è¡¨çº§é”çš„é™åˆ¶**ï¼šå¹¶å‘æ€§èƒ½è¾ƒå·®

```
å¹¶å‘äº‹åŠ¡ç¤ºä¾‹ï¼š

äº‹åŠ¡Aï¼šUPDATE user SET age=25 WHERE id=1;  â† é”å®šæ•´ä¸ªè¡¨
äº‹åŠ¡Bï¼šUPDATE user SET age=30 WHERE id=2;  â† ç­‰å¾…è¡¨é”é‡Šæ”¾

å¤åˆ¶è¡¨çŽ°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸¥æ ¼ä¸²è¡Œæ‰§è¡Œ     â”‚ â† è¡¨çº§é”å¼ºåˆ¶ä¸²è¡Œ
â”‚ å¤åˆ¶å®Œå…¨æŒ‰é¡ºåº   â”‚ â† è‡ªç„¶ä¿è¯é¡ºåº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 é”ç­‰å¾…å¯¹å¤åˆ¶çš„å½±å“


**é•¿æ—¶é—´é”ç­‰å¾…**ï¼šå¯èƒ½å¯¼è‡´å¤åˆ¶å»¶è¿Ÿ

```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ
SELECT 
    waiting_pid,
    waiting_query,
    blocking_pid,
    blocking_query,
    wait_age
FROM sys.innodb_lock_waits;

-- æŸ¥çœ‹å¤åˆ¶å»¶è¿Ÿ
SHOW SLAVE STATUS\G
-- å…³æ³¨ Seconds_Behind_Master å­—æ®µ
```

---

## 7. ðŸ”„ å­˜å‚¨å¼•æ“Žåˆ‡æ¢å¯¹å¤åˆ¶çš„å½±å“


### 7.1 å¼•æ“Žåˆ‡æ¢çš„å¤åˆ¶æŒ‘æˆ˜


å½“è¡¨çš„å­˜å‚¨å¼•æ“Žå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¤åˆ¶ç³»ç»Ÿéœ€è¦**æ­£ç¡®å¤„ç†**è¿™ç§å˜åŒ–ã€‚

### 7.2 åˆ‡æ¢è¿‡ç¨‹çš„å¤åˆ¶å¤„ç†


```sql
-- ä¸»åº“æ‰§è¡Œå¼•æ“Žåˆ‡æ¢
ALTER TABLE user_data ENGINE=InnoDB;
```

**å¤åˆ¶å¤„ç†æµç¨‹**ï¼š
```
ä¸»åº“æ“ä½œï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ›å»ºæ–°å¼•æ“Žçš„ä¸´æ—¶è¡¨       â”‚
â”‚ 2. å¤åˆ¶æ•°æ®åˆ°ä¸´æ—¶è¡¨         â”‚ â† å¯èƒ½å¾ˆè€—æ—¶
â”‚ 3. é‡å‘½åè¡¨å®Œæˆåˆ‡æ¢         â”‚
â”‚ 4. è®°å½•åˆ°Binlog             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä»Žåº“å¤åˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æŽ¥æ”¶åˆ°ALTER TABLEè¯­å¥    â”‚
â”‚ 2. æ‰§è¡Œç›¸åŒçš„å¼•æ“Žåˆ‡æ¢       â”‚ â† é‡å¤ä¸»åº“æ“ä½œ
â”‚ 3. ä¿æŒæ•°æ®ç»“æž„ä¸€è‡´         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 åˆ‡æ¢çš„æ³¨æ„äº‹é¡¹


**æ½œåœ¨é—®é¢˜**ï¼š
- **æ€§èƒ½å½±å“**ï¼šå¤§è¡¨åˆ‡æ¢å¯èƒ½å¯¼è‡´å¤åˆ¶å»¶è¿Ÿ
- **é”å½±å“**ï¼šåˆ‡æ¢è¿‡ç¨‹ä¸­çš„è¡¨é”å½±å“å¹¶å‘
- **ç‰¹æ€§å·®å¼‚**ï¼šæ–°å¼•æ“Žç‰¹æ€§å¯èƒ½å½±å“åº”ç”¨

```sql
-- æŸ¥çœ‹åˆ‡æ¢è¿›åº¦ï¼ˆMySQL 5.7+ï¼‰
SELECT 
    EVENT_NAME,
    WORK_COMPLETED,
    WORK_ESTIMATED
FROM performance_schema.events_stages_current 
WHERE EVENT_NAME LIKE '%alter%';
```

---

## 8. ðŸ¢ å¤šå¼•æ“ŽçŽ¯å¢ƒå¤åˆ¶å¤„ç†


### 8.1 å¤šå¼•æ“ŽçŽ¯å¢ƒçš„å¤æ‚æ€§


å®žé™…ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œ**ä¸€ä¸ªMySQLå®žä¾‹å¯èƒ½åŒæ—¶ä½¿ç”¨å¤šç§å­˜å‚¨å¼•æ“Ž**ï¼š

```
å…¸åž‹çš„å¤šå¼•æ“Žæž¶æž„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQLå®žä¾‹                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”œâ”€ user_info (InnoDB)      â”‚ â† ç”¨æˆ·æ ¸å¿ƒæ•°æ®
â”‚ â”œâ”€ log_data (MyISAM)       â”‚ â† æ—¥å¿—æ•°æ®  
â”‚ â”œâ”€ cache_table (Memory)    â”‚ â† ç¼“å­˜æ•°æ®
â”‚ â””â”€ config_data (InnoDB)    â”‚ â† é…ç½®æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 è·¨å¼•æ“Žäº‹åŠ¡å¤„ç†


**æŒ‘æˆ˜**ï¼šè·¨ä¸åŒå­˜å‚¨å¼•æ“Žçš„æ“ä½œæ— æ³•ä¿è¯äº‹åŠ¡æ€§

```sql
-- é—®é¢˜ç¤ºä¾‹ï¼šè·¨å¼•æ“Žæ“ä½œ
BEGIN;
INSERT INTO user_info (name) VALUES ('å¼ ä¸‰');      -- InnoDBè¡¨
INSERT INTO log_data (action) VALUES ('æ·»åŠ ç”¨æˆ·'); -- MyISAMè¡¨  
COMMIT;
```

**å¤åˆ¶å¤„ç†æ–¹å¼**ï¼š
```
MySQLçš„å¤„ç†ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. InnoDBæ“ä½œè®°å½•ä¸ºäº‹åŠ¡     â”‚
â”‚ 2. MyISAMæ“ä½œç«‹å³ç”Ÿæ•ˆå¹¶è®°å½• â”‚ â† æ— æ³•å›žæ»š
â”‚ 3. å¤åˆ¶æ—¶æŒ‰è¯­å¥é¡ºåºæ‰§è¡Œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¯èƒ½çš„é—®é¢˜ï¼š
å¦‚æžœInnoDBéƒ¨åˆ†å¤±è´¥ï¼ŒMyISAMéƒ¨åˆ†å·²ç»ç”Ÿæ•ˆ
â†’ ä¸»ä»Žæ•°æ®å¯èƒ½ä¸ä¸€è‡´
```

### 8.3 å¤šå¼•æ“ŽçŽ¯å¢ƒæœ€ä½³å®žè·µ


**é¿å…è·¨å¼•æ“Žäº‹åŠ¡**ï¼š
```sql
-- æŽ¨èåšæ³•ï¼šåˆ†åˆ«å¤„ç†
-- æ­¥éª¤1ï¼šå¤„ç†äº‹åŠ¡æ€§æ“ä½œ
BEGIN;
INSERT INTO user_info (name) VALUES ('å¼ ä¸‰');
COMMIT;

-- æ­¥éª¤2ï¼šå¤„ç†éžäº‹åŠ¡æ€§æ“ä½œ  
INSERT INTO log_data (action) VALUES ('æ·»åŠ ç”¨æˆ·');
```

---

## 9. âš™ï¸ å¼•æ“Žç‰¹æ€§å¯¹å¤åˆ¶çš„å½±å“


### 9.1 è‡ªå¢žåˆ—çš„å¤åˆ¶å·®å¼‚


**InnoDBè‡ªå¢žåˆ—**ï¼š
```sql
-- InnoDBè¡¨
CREATE TABLE innodb_test (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50)
) ENGINE=InnoDB;

-- å¹¶å‘æ’å…¥æ—¶
INSERT INTO innodb_test (name) VALUES ('A');  -- å¯èƒ½å¾—åˆ°id=1
INSERT INTO innodb_test (name) VALUES ('B');  -- å¯èƒ½å¾—åˆ°id=2
```

**å¤åˆ¶è¡¨çŽ°**ï¼š
```
ä¸»åº“æ‰§è¡Œé¡ºåºï¼šAâ†’Bï¼Œidåˆ†åˆ«ä¸º1,2
ä»Žåº“å¤åˆ¶æ—¶ï¼šä¸¥æ ¼æŒ‰ç…§Binlogé¡ºåºæ‰§è¡Œï¼Œidä¹Ÿæ˜¯1,2
ç»“æžœï¼šä¸»ä»Žä¸€è‡´ âœ“
```

**MyISAMè‡ªå¢žåˆ—**ï¼š
```sql
-- MyISAMè¡¨  
CREATE TABLE myisam_test (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50)
) ENGINE=MyISAM;
```

**å¤åˆ¶è¡¨çŽ°**ï¼š
```
MyISAMçš„è‡ªå¢žå€¼ç«‹å³åˆ†é…å¹¶é”å®š
å¤åˆ¶æ—¶èƒ½ä¿è¯è‡ªå¢žå€¼çš„ä¸€è‡´æ€§
ä½†å¹¶å‘æ€§èƒ½ä¸å¦‚InnoDB
```

### 9.2 å¤–é”®çº¦æŸçš„å¤åˆ¶


**ä»…InnoDBæ”¯æŒå¤–é”®**ï¼š
```sql
-- ä¸»è¡¨
CREATE TABLE department (
    id INT PRIMARY KEY,
    name VARCHAR(50)
) ENGINE=InnoDB;

-- å­è¡¨ï¼ˆæœ‰å¤–é”®çº¦æŸï¼‰
CREATE TABLE employee (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES department(id)
) ENGINE=InnoDB;
```

**å¤åˆ¶å½±å“**ï¼š
```
å¤–é”®çº¦æŸçš„å¤åˆ¶ç‰¹ç‚¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. çº¦æŸæ£€æŸ¥åœ¨ä¸»ä»Žéƒ½æ‰§è¡Œ     â”‚
â”‚ 2. è¿åçº¦æŸçš„æ“ä½œä¼šå¤±è´¥     â”‚
â”‚ 3. å¤åˆ¶å¯èƒ½å› çº¦æŸå¤±è´¥ä¸­æ–­   â”‚ â† éœ€è¦å…³æ³¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 å…¨æ–‡ç´¢å¼•çš„å¤åˆ¶


**MyISAM vs InnoDBå…¨æ–‡ç´¢å¼•**ï¼š
```sql
-- MyISAMå…¨æ–‡ç´¢å¼•ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
CREATE TABLE articles_myisam (
    id INT PRIMARY KEY,
    title VARCHAR(200),
    content TEXT,
    FULLTEXT(title, content)
) ENGINE=MyISAM;

-- InnoDBå…¨æ–‡ç´¢å¼•ï¼ˆMySQL 5.6+ï¼‰
CREATE TABLE articles_innodb (
    id INT PRIMARY KEY,
    title VARCHAR(200), 
    content TEXT,
    FULLTEXT(title, content)
) ENGINE=InnoDB;
```

**å¤åˆ¶å·®å¼‚**ï¼š
```
MyISAMå…¨æ–‡ç´¢å¼•ï¼š
â”œâ”€ ç´¢å¼•ç«‹å³æ›´æ–°
â”œâ”€ å¤åˆ¶æ—¶é‡å»ºç´¢å¼•
â””â”€ å¯èƒ½æœ‰æ€§èƒ½å·®å¼‚

InnoDBå…¨æ–‡ç´¢å¼•ï¼š
â”œâ”€ äº‹åŠ¡æ€§ç´¢å¼•æ›´æ–°
â”œâ”€ å¤åˆ¶ä¿æŒä¸€è‡´æ€§
â””â”€ æ›´å¥½çš„å¹¶å‘æ€§èƒ½
```

---

## 10. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ åŒæ—¥å¿—åè°ƒï¼šRedo Log + Binlog ç¡®ä¿ä¸€è‡´æ€§
ðŸ”¸ ä¸¤é˜¶æ®µæäº¤ï¼šInnoDBä¸Žå¤åˆ¶ç³»ç»Ÿçš„åä½œæœºåˆ¶  
ðŸ”¸ æäº¤é’©å­ï¼šå­˜å‚¨å¼•æ“Žé€šçŸ¥å¤åˆ¶ç³»ç»Ÿçš„æ¡¥æ¢
ðŸ”¸ å´©æºƒæ¢å¤ï¼šä»¥Binlogä¸ºå‡†åè°ƒå„å¼•æ“ŽçŠ¶æ€
ðŸ”¸ é”æœºåˆ¶å½±å“ï¼šä¸åŒé”ç­–ç•¥å½±å“å¤åˆ¶æ€§èƒ½
ðŸ”¸ å¼•æ“Žåˆ‡æ¢ï¼šéœ€è¦è€ƒè™‘å¤åˆ¶çš„è¿žç»­æ€§
ðŸ”¸ å¤šå¼•æ“ŽçŽ¯å¢ƒï¼šé¿å…è·¨å¼•æ“Žäº‹åŠ¡æ“ä½œ
ðŸ”¸ ç‰¹æ€§å·®å¼‚ï¼šå„å¼•æ“Žç‰¹æ€§å¯¹å¤åˆ¶çš„ä¸åŒå½±å“
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤**
```
é—®é¢˜ï¼šå¦‚æžœInnoDBæäº¤äº†ï¼Œä½†Binlogå†™å…¥å¤±è´¥æ€Žä¹ˆåŠžï¼Ÿ
ç»“æžœï¼šä¸»åº“æ•°æ®æ”¹å˜ï¼Œä½†ä»Žåº“ä¸çŸ¥é“ â†’ æ•°æ®ä¸ä¸€è‡´

è§£å†³ï¼šä¸¤é˜¶æ®µæäº¤ç¡®ä¿è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥
ä»·å€¼ï¼šä¿è¯ä¸»ä»Žæ•°æ®çš„ä¸¥æ ¼ä¸€è‡´æ€§
```

**ðŸ”¹ å­˜å‚¨å¼•æ“Žç‰¹æ€§å¦‚ä½•å½±å“å¤åˆ¶**
```
äº‹åŠ¡æ€§å¼•æ“Ž(InnoDB)ï¼š
âœ“ æ”¯æŒå›žæ»šï¼Œå¤åˆ¶å®‰å…¨æ€§é«˜
âœ“ è¡Œçº§é”ï¼Œå¹¶å‘æ€§èƒ½å¥½
âœ“ å´©æºƒæ¢å¤èƒ½åŠ›å¼º

éžäº‹åŠ¡å¼•æ“Ž(MyISAM)ï¼š
âœ— ä¸æ”¯æŒå›žæ»šï¼Œå¤åˆ¶é£Žé™©é«˜
âœ— è¡¨çº§é”ï¼Œå¹¶å‘æ€§èƒ½å·®  
âœ“ ç»“æž„ç®€å•ï¼ŒæŸäº›åœºæ™¯æ€§èƒ½å¥½
```

**ðŸ”¹ å¤šå¼•æ“ŽçŽ¯å¢ƒçš„æœ€ä½³å®žè·µ**
```
æ ¸å¿ƒåŽŸåˆ™ï¼š
1. é¿å…è·¨å¼•æ“Žäº‹åŠ¡æ“ä½œ
2. é€‰æ‹©åˆé€‚å¼•æ“Žæ‰¿è½½ä¸åŒç±»åž‹æ•°æ®
3. ç›‘æŽ§å„å¼•æ“Žçš„å¤åˆ¶è¡¨çŽ°
4. ç»Ÿä¸€ä½¿ç”¨InnoDBï¼ˆæŽ¨èï¼‰
```

### 10.3 å®žé™…åº”ç”¨ä»·å€¼


**ç”Ÿäº§çŽ¯å¢ƒæŒ‡å¯¼**ï¼š
- **å¼•æ“Žé€‰æ‹©**ï¼šæ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©åˆé€‚å¼•æ“Ž
- **å¤åˆ¶ç›‘æŽ§**ï¼šå…³æ³¨ä¸åŒå¼•æ“Žçš„å¤åˆ¶è¡¨çŽ°
- **æ•…éšœæ¢å¤**ï¼šç†è§£å„å¼•æ“Žçš„æ¢å¤æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåŸºäºŽå¼•æ“Žç‰¹æ€§ä¼˜åŒ–å¤åˆ¶æ€§èƒ½

**æ•…éšœæŽ’æŸ¥æ€è·¯**ï¼š
- **å¤åˆ¶ä¸­æ–­**ï¼šæ£€æŸ¥æ˜¯å¦æœ‰è·¨å¼•æ“Žæ“ä½œ
- **æ•°æ®ä¸ä¸€è‡´**ï¼šéªŒè¯ä¸¤é˜¶æ®µæäº¤æ˜¯å¦æ­£å¸¸
- **æ€§èƒ½é—®é¢˜**ï¼šåˆ†æžé”ç«žäº‰å’Œå¼•æ“Žç‰¹æ€§

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å­˜å‚¨å¼•æ“Žå„ä¸åŒï¼Œå¤åˆ¶åè°ƒè¦è°¨æ…Ž
ä¸¤é˜¶æ®µæäº¤ä¿ä¸€è‡´ï¼ŒåŒæ—¥å¿—åŒæ­¥æ˜¯å…³é”®
InnoDBäº‹åŠ¡å¤åˆ¶å¥½ï¼ŒMyISAMç®€å•è¦å°å¿ƒ
å¤šå¼•æ“ŽçŽ¯å¢ƒé¿è·¨è¶Šï¼Œç›‘æŽ§è°ƒä¼˜ä¿æ€§èƒ½
```