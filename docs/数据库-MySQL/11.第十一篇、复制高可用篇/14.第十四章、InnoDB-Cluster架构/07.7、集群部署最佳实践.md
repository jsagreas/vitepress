---
title: 7ã€é›†ç¾¤éƒ¨ç½²æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [InnoDB ClusteråŸºç¡€æ¦‚å¿µ](#1-InnoDB-ClusteråŸºç¡€æ¦‚å¿µ)
2. [ç¡¬ä»¶ä¸ç½‘ç»œè§„åˆ’](#2-ç¡¬ä»¶ä¸ç½‘ç»œè§„åˆ’)
3. [é›†ç¾¤åˆå§‹åŒ–ä¸é…ç½®](#3-é›†ç¾¤åˆå§‹åŒ–ä¸é…ç½®)
4. [èŠ‚ç‚¹ç®¡ç†ä¸è§’è‰²åˆ†é…](#4-èŠ‚ç‚¹ç®¡ç†ä¸è§’è‰²åˆ†é…)
5. [å®‰å…¨é…ç½®ç­–ç•¥](#5-å®‰å…¨é…ç½®ç­–ç•¥)
6. [æ€§èƒ½å‚æ•°è°ƒä¼˜](#6-æ€§èƒ½å‚æ•°è°ƒä¼˜)
7. [éƒ¨ç½²æµç¨‹æ ‡å‡†åŒ–](#7-éƒ¨ç½²æµç¨‹æ ‡å‡†åŒ–)
8. [ç°ä»£åŒ–éƒ¨ç½²ç­–ç•¥](#8-ç°ä»£åŒ–éƒ¨ç½²ç­–ç•¥)
9. [è¿ç»´è§„èŒƒä¸å·¥å…·](#9-è¿ç»´è§„èŒƒä¸å·¥å…·)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ InnoDB ClusteråŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯InnoDB Cluster


**ğŸ“‹ ç®€å•ç†è§£**ï¼š
InnoDB Clusterå°±åƒæ˜¯æŠŠå¤šå°MySQLæœåŠ¡å™¨ç»„ç»‡æˆä¸€ä¸ª**å›¢é˜Ÿ**ï¼Œè¿™ä¸ªå›¢é˜Ÿé‡Œæœ‰ä¸€ä¸ª**é˜Ÿé•¿**ï¼ˆä¸»æœåŠ¡å™¨ï¼‰è´Ÿè´£å¤„ç†å†™æ“ä½œï¼Œå…¶ä»–**é˜Ÿå‘˜**ï¼ˆä»æœåŠ¡å™¨ï¼‰è´Ÿè´£å¤„ç†è¯»æ“ä½œã€‚å½“é˜Ÿé•¿å‡ºé—®é¢˜æ—¶ï¼Œä¼šè‡ªåŠ¨é€‰å‡ºæ–°é˜Ÿé•¿ï¼Œä¿è¯ä¸šåŠ¡ä¸ä¸­æ–­ã€‚

```
ä¼ ç»Ÿå•æœºMySQLï¼š           InnoDB Clusteré›†ç¾¤ï¼š
   [MySQL]                 [ä¸»èŠ‚ç‚¹] â† å†™æ“ä½œ
     â†“                      â†™  â†˜
   ä¸šåŠ¡åº”ç”¨                [ä»èŠ‚ç‚¹] [ä»èŠ‚ç‚¹] â† è¯»æ“ä½œ
```

**ğŸ”¸ æ ¸å¿ƒç»„ä»¶è§£é‡Š**ï¼š
- **MySQL Group Replication**ï¼šè´Ÿè´£æ•°æ®åŒæ­¥ï¼Œç¡®ä¿æ‰€æœ‰æœåŠ¡å™¨æ•°æ®ä¸€è‡´
- **MySQL Router**ï¼šæ™ºèƒ½è·¯ç”±å™¨ï¼Œè‡ªåŠ¨æŠŠè¯·æ±‚åˆ†å‘åˆ°åˆé€‚çš„æœåŠ¡å™¨
- **MySQL Shell**ï¼šç®¡ç†å·¥å…·ï¼Œç”¨æ¥åˆ›å»ºå’Œç®¡ç†é›†ç¾¤

### 1.2 InnoDB Clusterè§£å†³äº†ä»€ä¹ˆé—®é¢˜


**ğŸ’¡ ä¸šåŠ¡åœºæ™¯ç†è§£**ï¼š
```
é—®é¢˜åœºæ™¯ï¼š
âŒ å•ç‚¹æ•…éšœï¼šMySQLæœåŠ¡å™¨å®•æœºï¼Œæ•´ä¸ªä¸šåŠ¡åœæ­¢
âŒ æ€§èƒ½ç“¶é¢ˆï¼šæ‰€æœ‰è¯»å†™éƒ½åœ¨ä¸€å°æœåŠ¡å™¨ä¸Š
âŒ æ•°æ®ä¸¢å¤±é£é™©ï¼šæœåŠ¡å™¨ç¡¬ç›˜æŸåï¼Œæ•°æ®å…¨éƒ¨ä¸¢å¤±

InnoDB Clusterè§£å†³æ–¹æ¡ˆï¼š
âœ… é«˜å¯ç”¨ï¼šä¸€å°æœåŠ¡å™¨æ•…éšœï¼Œå…¶ä»–æœåŠ¡å™¨ç»§ç»­å·¥ä½œ
âœ… è´Ÿè½½åˆ†æ‹…ï¼šè¯»æ“ä½œåˆ†å‘åˆ°å¤šå°æœåŠ¡å™¨
âœ… æ•°æ®å®‰å…¨ï¼šæ•°æ®åœ¨å¤šå°æœåŠ¡å™¨ä¸Šéƒ½æœ‰å¤‡ä»½
```

### 1.3 é›†ç¾¤æ¶æ„æ¨¡å¼


**ğŸ—ï¸ å…¸å‹æ¶æ„å›¾ç¤º**ï¼š
```
åº”ç”¨å±‚ï¼š
[Webåº”ç”¨] [APIæœåŠ¡] [åå°ä»»åŠ¡]
     â†“        â†“        â†“
è·¯ç”±å±‚ï¼š
    [MySQL Routeré›†ç¾¤]
     â†“        â†“        â†“
æ•°æ®åº“å±‚ï¼š
[ä¸»èŠ‚ç‚¹] [ä»èŠ‚ç‚¹1] [ä»èŠ‚ç‚¹2]
   â†•        â†•         â†•
[æ•°æ®åŒæ­¥ Group Replication]
```

---

## 2. ğŸ–¥ï¸ ç¡¬ä»¶ä¸ç½‘ç»œè§„åˆ’


### 2.1 ç¡¬ä»¶é€‰å‹å»ºè®®


#### ğŸ’¾ æœåŠ¡å™¨é…ç½®æŒ‡å¯¼


| ä¸šåŠ¡è§„æ¨¡ | **CPUé…ç½®** | **å†…å­˜é…ç½®** | **å­˜å‚¨é…ç½®** | **ç½‘ç»œé…ç½®** |
|---------|------------|-------------|-------------|-------------|
| ğŸŸ¢ **å°å‹** | `4æ ¸å¿ƒ` | `8GB` | `SSD 500GB` | `åƒå…†ç½‘å¡` |
| ğŸŸ¡ **ä¸­å‹** | `8æ ¸å¿ƒ` | `32GB` | `SSD 1TB + HDD 2TB` | `ä¸‡å…†ç½‘å¡` |
| ğŸ”´ **å¤§å‹** | `16æ ¸å¿ƒ+` | `64GB+` | `NVMe SSD 2TB+` | `ä¸‡å…†ç½‘å¡+` |

**ğŸ”§ é€‰å‹åŸåˆ™è¯´æ˜**ï¼š
```
CPUé€‰æ‹©ï¼š
â€¢ ä¸»èŠ‚ç‚¹ï¼šéœ€è¦æ›´å¼ºçš„å•æ ¸æ€§èƒ½ï¼ˆå†™æ“ä½œå¯†é›†ï¼‰
â€¢ ä»èŠ‚ç‚¹ï¼šå¯ä»¥é€‰æ‹©å¤šæ ¸å¿ƒï¼ˆè¯»æ“ä½œå¹¶å‘ï¼‰

å†…å­˜é…ç½®ï¼š
â€¢ InnoDBç¼“å†²æ± ï¼šå»ºè®®å ç‰©ç†å†…å­˜çš„70-80%
â€¢ æ“ä½œç³»ç»Ÿé¢„ç•™ï¼šè‡³å°‘ä¿ç•™4-8GBç»™ç³»ç»Ÿ

å­˜å‚¨ç­–ç•¥ï¼š
â€¢ æ•°æ®æ–‡ä»¶ï¼šä½¿ç”¨SSDå­˜å‚¨ï¼Œæé«˜éšæœºè¯»å†™æ€§èƒ½
â€¢ æ—¥å¿—æ–‡ä»¶ï¼šå¯ä»¥ä½¿ç”¨é«˜é€ŸSSDï¼Œä¿è¯äº‹åŠ¡æ€§èƒ½
â€¢ å¤‡ä»½æ–‡ä»¶ï¼šå¯ä»¥ä½¿ç”¨ç›¸å¯¹ä¾¿å®œçš„HDDå­˜å‚¨
```

#### ğŸŒ ç½‘ç»œæ‹“æ‰‘è®¾è®¡


**ğŸ“¡ ç½‘ç»œæ¶æ„ç¤ºæ„**ï¼š
```
                 [è´Ÿè½½å‡è¡¡å™¨]
                      |
              [åº”ç”¨æœåŠ¡å™¨é›†ç¾¤]
                      |
                [MySQL Router]
                   /  |  \
              [èŠ‚ç‚¹1][èŠ‚ç‚¹2][èŠ‚ç‚¹3]
                  \   |   /
              [Group Replicationç½‘ç»œ]
                      |
                [ç®¡ç†ç½‘ç»œ/ç›‘æ§]
```

**ğŸ”¸ ç½‘ç»œè¦æ±‚**ï¼š
- **ä¸šåŠ¡ç½‘ç»œ**ï¼šå¤„ç†åº”ç”¨ç¨‹åºè¿æ¥ï¼Œè¦æ±‚ä½å»¶è¿Ÿ
- **å¤åˆ¶ç½‘ç»œ**ï¼šGroup Replicationæ•°æ®åŒæ­¥ï¼Œè¦æ±‚é«˜å¸¦å®½
- **ç®¡ç†ç½‘ç»œ**ï¼šè¿ç»´ç®¡ç†å’Œç›‘æ§ï¼Œå¯ä»¥ä½¿ç”¨ç‹¬ç«‹ç½‘æ®µ

### 2.2 é›†ç¾¤è§„æ¨¡è§„åˆ’


**ğŸ“Š èŠ‚ç‚¹æ•°é‡å»ºè®®**ï¼š
```
3èŠ‚ç‚¹é›†ç¾¤ï¼ˆæ¨èæœ€å°è§„æ¨¡ï¼‰ï¼š
â€¢ ä¼˜ç‚¹ï¼šèƒ½å¤Ÿå®¹å¿1ä¸ªèŠ‚ç‚¹æ•…éšœ
â€¢ ç¼ºç‚¹ï¼šæ•…éšœåæ€§èƒ½ä¼šä¸‹é™

5èŠ‚ç‚¹é›†ç¾¤ï¼ˆæ¨èç”Ÿäº§è§„æ¨¡ï¼‰ï¼š
â€¢ ä¼˜ç‚¹ï¼šèƒ½å¤Ÿå®¹å¿2ä¸ªèŠ‚ç‚¹æ•…éšœï¼Œæ€§èƒ½æ›´ç¨³å®š
â€¢ ç¼ºç‚¹ï¼šç®¡ç†å¤æ‚åº¦å¢åŠ 

7èŠ‚ç‚¹åŠä»¥ä¸Šï¼š
â€¢ é€‚ç”¨åœºæ™¯ï¼šè¶…å¤§è§„æ¨¡ã€åœ°ç†åˆ†å¸ƒå¼éƒ¨ç½²
â€¢ æ³¨æ„ï¼šGroup Replicationåè°ƒå¼€é”€ä¼šå¢åŠ 
```

### 2.3 å®¹é‡è¯„ä¼°æ–¹æ³•


**ğŸ“ˆ å®¹é‡è§„åˆ’æ­¥éª¤**ï¼š
```
ç¬¬1æ­¥ï¼šä¸šåŠ¡é‡è¯„ä¼°
â€¢ å½“å‰QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰
â€¢ æ•°æ®å¢é•¿é€Ÿåº¦ï¼ˆæ¯å¤©/æ¯æœˆï¼‰
â€¢ é«˜å³°æœŸæµé‡å€æ•°

ç¬¬2æ­¥ï¼šèµ„æºéœ€æ±‚è®¡ç®—
â€¢ CPUï¼šQPS Ã— å•æ¬¡æŸ¥è¯¢CPUæ¶ˆè€—
â€¢ å†…å­˜ï¼šæ•°æ®é›†å¤§å° Ã— 1.2ï¼ˆç¼“å†²æ± ï¼‰
â€¢ å­˜å‚¨ï¼šæ•°æ®å¤§å° Ã— å¢é•¿ç‡ Ã— 2ï¼ˆå†—ä½™ï¼‰

ç¬¬3æ­¥ï¼šé›†ç¾¤èµ„æºåˆ†é…
â€¢ ä¸»èŠ‚ç‚¹ï¼šæ‰¿æ‹…100%å†™è´Ÿè½½ + éƒ¨åˆ†è¯»è´Ÿè½½
â€¢ ä»èŠ‚ç‚¹ï¼šå¹³å‡åˆ†æ‹…è¯»è´Ÿè½½
â€¢ é¢„ç•™30%èµ„æºç”¨äºæ•…éšœåˆ‡æ¢
```

---

## 3. âš™ï¸ é›†ç¾¤åˆå§‹åŒ–ä¸é…ç½®


### 3.1 é›†ç¾¤åˆå§‹åŒ–æµç¨‹


**ğŸš€ æ ‡å‡†åˆå§‹åŒ–æ­¥éª¤**ï¼š

#### æ­¥éª¤1ï¼šç¯å¢ƒå‡†å¤‡

```bash
# 1. ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹æ—¶é—´åŒæ­¥
sudo systemctl enable ntp
sudo systemctl start ntp

# 2. é…ç½®ä¸»æœºåè§£æ
echo "192.168.1.10 mysql-node1" >> /etc/hosts
echo "192.168.1.11 mysql-node2" >> /etc/hosts  
echo "192.168.1.12 mysql-node3" >> /etc/hosts

# 3. å…³é—­é˜²ç«å¢™æˆ–å¼€æ”¾ç«¯å£
# MySQL: 3306, Group Replication: 33061, X Protocol: 33060
```

#### æ­¥éª¤2ï¼šMySQLå®ä¾‹é…ç½®

```ini
# /etc/mysql/mysql.conf.d/mysqld.cnf
[mysqld]
# åŸºç¡€é…ç½®
server_id = 1                    # æ¯ä¸ªèŠ‚ç‚¹å”¯ä¸€
bind_address = 0.0.0.0          # å…è®¸è¿œç¨‹è¿æ¥
port = 3306

# Group Replicationé…ç½®
plugin_load_add = 'group_replication.so'
group_replication_group_name = "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"
group_replication_start_on_boot = off
group_replication_local_address = "mysql-node1:33061"
group_replication_group_seeds = "mysql-node1:33061,mysql-node2:33061,mysql-node3:33061"

# æ€§èƒ½ä¼˜åŒ–
innodb_buffer_pool_size = 1G     # è°ƒæ•´ä¸ºé€‚åˆçš„å¤§å°
innodb_log_file_size = 256M
```

#### æ­¥éª¤3ï¼šç”¨æˆ·æƒé™é…ç½®

```sql
-- åˆ›å»ºé›†ç¾¤ç®¡ç†ç”¨æˆ·
CREATE USER 'clusteradmin'@'%' IDENTIFIED BY 'StrongPassword123!';
GRANT ALL PRIVILEGES ON *.* TO 'clusteradmin'@'%' WITH GRANT OPTION;

-- åˆ›å»ºåº”ç”¨è¿æ¥ç”¨æˆ·
CREATE USER 'appuser'@'%' IDENTIFIED BY 'AppPassword123!';
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp.* TO 'appuser'@'%';

FLUSH PRIVILEGES;
```

### 3.2 ä½¿ç”¨MySQL Shellåˆ›å»ºé›†ç¾¤


**ğŸ”§ é›†ç¾¤åˆ›å»ºå‘½ä»¤**ï¼š
```javascript
// 1. è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
\connect clusteradmin@mysql-node1:3306

// 2. æ£€æŸ¥å®ä¾‹é…ç½®
dba.checkInstanceConfiguration()

// 3. é…ç½®å®ä¾‹ï¼ˆå¦‚æœéœ€è¦ï¼‰
dba.configureInstance()

// 4. åˆ›å»ºé›†ç¾¤
var cluster = dba.createCluster('myCluster')

// 5. æ·»åŠ å…¶ä»–èŠ‚ç‚¹
cluster.addInstance('clusteradmin@mysql-node2:3306')
cluster.addInstance('clusteradmin@mysql-node3:3306')

// 6. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
cluster.status()
```

### 3.3 é…ç½®åŒæ­¥æœºåˆ¶


**ğŸ“‹ åŒæ­¥é…ç½®è¯´æ˜**ï¼š
```
Group Replicationå·¥ä½œåŸç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å†™å…¥äº‹åŠ¡     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»èŠ‚ç‚¹    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’    â”‚ Groupç»„åè°ƒ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                              â†“
   æœ¬åœ°åº”ç”¨äº‹åŠ¡                    å¹¿æ’­åˆ°æ‰€æœ‰èŠ‚ç‚¹
       â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä»èŠ‚ç‚¹1   â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   ä»èŠ‚ç‚¹2   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    åº”ç”¨ç›¸åŒäº‹åŠ¡   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®ç‰¹ç‚¹ï¼š
â€¢ æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šåº”ç”¨ç›¸åŒçš„äº‹åŠ¡
â€¢ å¤šæ•°èŠ‚ç‚¹åŒæ„æ‰ä¼šæäº¤äº‹åŠ¡
â€¢ è‡ªåŠ¨æ£€æµ‹å’Œè§£å†³å†²çª
```

---

## 4. ğŸ‘¥ èŠ‚ç‚¹ç®¡ç†ä¸è§’è‰²åˆ†é…


### 4.1 èŠ‚ç‚¹è§’è‰²åˆ†é…


**ğŸ¯ è§’è‰²åˆ†å·¥è¯´æ˜**ï¼š

#### PrimaryèŠ‚ç‚¹ï¼ˆä¸»èŠ‚ç‚¹ï¼‰

```
èŒè´£ï¼š
âœ… å¤„ç†æ‰€æœ‰å†™æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰
âœ… å¤„ç†éƒ¨åˆ†è¯»æ“ä½œ
âœ… åè°ƒGroup Replication

ç‰¹ç‚¹ï¼š
â€¢ åŒæ—¶åªæœ‰ä¸€ä¸ªPrimaryèŠ‚ç‚¹
â€¢ æ•…éšœæ—¶è‡ªåŠ¨é€‰ä¸¾æ–°çš„Primary
â€¢ æ‰¿æ‹…æœ€å¤§çš„æ€§èƒ½å‹åŠ›
```

#### SecondaryèŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹ï¼‰

```
èŒè´£ï¼š
âœ… å¤„ç†è¯»æ“ä½œï¼ˆSELECTï¼‰
âœ… å‚ä¸Group ReplicationæŠ•ç¥¨
âœ… ä½œä¸ºPrimaryèŠ‚ç‚¹çš„å¤‡é€‰

ç‰¹ç‚¹ï¼š
â€¢ å¯ä»¥æœ‰å¤šä¸ªSecondaryèŠ‚ç‚¹
â€¢ åªè¯»æ¨¡å¼è¿è¡Œ
â€¢ éšæ—¶å‡†å¤‡æå‡ä¸ºPrimary
```

### 4.2 èŠ‚ç‚¹é…ç½®ç®¡ç†


**âš™ï¸ é…ç½®ç®¡ç†ç­–ç•¥**ï¼š

#### é…ç½®æ–‡ä»¶æ ‡å‡†åŒ–

```bash
# åˆ›å»ºé…ç½®æ¨¡æ¿
cat > /etc/mysql/cluster-template.cnf << 'EOF'
[mysqld]
# åŸºç¡€é…ç½®æ¨¡æ¿
server_id = ${SERVER_ID}
bind_address = 0.0.0.0
report_host = ${HOSTNAME}

# Group Replicationæ¨¡æ¿  
group_replication_local_address = "${HOSTNAME}:33061"
group_replication_group_seeds = "${GROUP_SEEDS}"

# æ€§èƒ½é…ç½®æ¨¡æ¿
innodb_buffer_pool_size = ${BUFFER_POOL_SIZE}
EOF

# ä½¿ç”¨è„šæœ¬ç”Ÿæˆå®é™…é…ç½®
./generate-config.sh node1 192.168.1.10
```

#### é…ç½®ä¸€è‡´æ€§æ£€æŸ¥

```sql
-- æ£€æŸ¥é‡è¦é…ç½®å‚æ•°
SELECT 
    variable_name,
    variable_value 
FROM performance_schema.global_variables 
WHERE variable_name IN (
    'group_replication_group_name',
    'group_replication_local_address',
    'server_id',
    'innodb_buffer_pool_size'
);
```

### 4.3 èŠ‚ç‚¹çŠ¶æ€ç›‘æ§


**ğŸ“Š çŠ¶æ€ç›‘æ§æŒ‡æ ‡**ï¼š
```sql
-- æŸ¥çœ‹é›†ç¾¤æ•´ä½“çŠ¶æ€
SELECT 
    member_id,
    member_host,
    member_port,
    member_state,
    member_role
FROM performance_schema.replication_group_members;

-- æŸ¥çœ‹èŠ‚ç‚¹å¥åº·çŠ¶å†µ
SELECT 
    channel_name,
    member_id,
    count_transactions_in_queue,
    count_transactions_checked,
    count_conflicts_detected
FROM performance_schema.replication_group_member_stats;
```

---

## 5. ğŸ”’ å®‰å…¨é…ç½®ç­–ç•¥


### 5.1 ç½‘ç»œå®‰å…¨é…ç½®


**ğŸ›¡ï¸ ç½‘ç»œå®‰å…¨æªæ–½**ï¼š

#### SSL/TLSåŠ å¯†é…ç½®

```ini
# MySQLé…ç½®æ–‡ä»¶
[mysqld]
# å¯ç”¨SSL
ssl_ca = /etc/mysql/ssl/ca.pem
ssl_cert = /etc/mysql/ssl/server-cert.pem  
ssl_key = /etc/mysql/ssl/server-key.pem

# Group Replication SSLé…ç½®
group_replication_ssl_mode = REQUIRED
group_replication_recovery_use_ssl = ON
```

#### é˜²ç«å¢™è§„åˆ™é…ç½®

```bash
# åªå…è®¸é›†ç¾¤èŠ‚ç‚¹é—´é€šä¿¡
iptables -A INPUT -s 192.168.1.0/24 -p tcp --dport 3306 -j ACCEPT
iptables -A INPUT -s 192.168.1.0/24 -p tcp --dport 33061 -j ACCEPT
iptables -A INPUT -p tcp --dport 3306 -j DROP
```

### 5.2 ç”¨æˆ·æƒé™ç®¡ç†


**ğŸ‘¤ æƒé™åˆ†çº§ç­–ç•¥**ï¼š
```sql
-- 1. é›†ç¾¤ç®¡ç†å‘˜ï¼ˆæœ€é«˜æƒé™ï¼‰
CREATE USER 'cluster_admin'@'localhost' IDENTIFIED BY 'SuperStrongPass!';
GRANT ALL PRIVILEGES ON *.* TO 'cluster_admin'@'localhost' WITH GRANT OPTION;

-- 2. åº”ç”¨ç”¨æˆ·ï¼ˆä¸šåŠ¡æƒé™ï¼‰
CREATE USER 'app_user'@'192.168.1.%' IDENTIFIED BY 'AppStrongPass!';
GRANT SELECT, INSERT, UPDATE, DELETE ON app_db.* TO 'app_user'@'192.168.1.%';

-- 3. åªè¯»ç”¨æˆ·ï¼ˆæŸ¥è¯¢æƒé™ï¼‰
CREATE USER 'readonly_user'@'%' IDENTIFIED BY 'ReadOnlyPass!';
GRANT SELECT ON app_db.* TO 'readonly_user'@'%';

-- 4. ç›‘æ§ç”¨æˆ·ï¼ˆç›‘æ§æƒé™ï¼‰
CREATE USER 'monitor_user'@'localhost' IDENTIFIED BY 'MonitorPass!';
GRANT PROCESS, REPLICATION CLIENT ON *.* TO 'monitor_user'@'localhost';
```

### 5.3 å®¡è®¡ä¸æ—¥å¿—


**ğŸ“ å®‰å…¨å®¡è®¡é…ç½®**ï¼š
```ini
# å¯ç”¨å®¡è®¡æ—¥å¿—
[mysqld]
plugin_load = audit_log.so
audit_log_policy = ALL
audit_log_file = /var/log/mysql/audit.log
audit_log_rotate_on_size = 100M

# å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log = ON
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
```

---

## 6. ğŸš€ æ€§èƒ½å‚æ•°è°ƒä¼˜


### 6.1 InnoDBå‚æ•°ä¼˜åŒ–


**âš¡ æ ¸å¿ƒå‚æ•°é…ç½®**ï¼š
```ini
[mysqld]
# InnoDBç¼“å†²æ± é…ç½®
innodb_buffer_pool_size = 8G           # è®¾ä¸ºç‰©ç†å†…å­˜çš„70-80%
innodb_buffer_pool_instances = 8       # å¤§å†…å­˜æ—¶å»ºè®®è®¾ç½®å¤šä¸ªå®ä¾‹

# InnoDBæ—¥å¿—é…ç½®
innodb_log_file_size = 1G              # æ—¥å¿—æ–‡ä»¶å¤§å°
innodb_log_buffer_size = 64M           # æ—¥å¿—ç¼“å†²åŒº
innodb_flush_log_at_trx_commit = 1     # äº‹åŠ¡å®‰å…¨æ€§

# InnoDB I/Oé…ç½®
innodb_io_capacity = 2000              # SSDå¯è®¾ç½®æ›´é«˜
innodb_io_capacity_max = 4000          # æœ€å¤§I/Oèƒ½åŠ›
innodb_read_io_threads = 8             # è¯»çº¿ç¨‹æ•°
innodb_write_io_threads = 8            # å†™çº¿ç¨‹æ•°
```

### 6.2 Group Replicationæ€§èƒ½ä¼˜åŒ–


**ğŸ”§ å¤åˆ¶æ€§èƒ½å‚æ•°**ï¼š
```ini
# Group Replicationè°ƒä¼˜
group_replication_flow_control_mode = QUOTA
group_replication_flow_control_certifier_threshold = 25000
group_replication_flow_control_applier_threshold = 25000

# ç½‘ç»œä¼˜åŒ–
group_replication_compression_threshold = 1000000
group_replication_message_cache_size = 1G
```

### 6.3 è¿æ¥ä¸å¹¶å‘ä¼˜åŒ–


**ğŸ“ˆ å¹¶å‘å¤„ç†é…ç½®**ï¼š
```ini
# è¿æ¥é…ç½®
max_connections = 2000                  # æœ€å¤§è¿æ¥æ•°
max_user_connections = 1800            # å•ç”¨æˆ·æœ€å¤§è¿æ¥
connect_timeout = 10                   # è¿æ¥è¶…æ—¶

# çº¿ç¨‹é…ç½®  
thread_cache_size = 100                # çº¿ç¨‹ç¼“å­˜
thread_pool_size = 16                  # çº¿ç¨‹æ± å¤§å°ï¼ˆEnterpriseç‰ˆæœ¬ï¼‰

# æŸ¥è¯¢ç¼“å­˜ï¼ˆæ ¹æ®æƒ…å†µå¯ç”¨ï¼‰
query_cache_type = OFF                 # 8.0ç‰ˆæœ¬å»ºè®®å…³é—­
query_cache_size = 0
```

---

## 7. ğŸ“‹ éƒ¨ç½²æµç¨‹æ ‡å‡†åŒ–


### 7.1 éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•


**âœ… ç¯å¢ƒæ£€æŸ¥æ¸…å•**ï¼š
```
ç¡¬ä»¶æ£€æŸ¥ï¼š
â–¡ CPUè§„æ ¼æ»¡è¶³è¦æ±‚
â–¡ å†…å­˜å®¹é‡å……è¶³
â–¡ å­˜å‚¨ç©ºé—´è¶³å¤Ÿ
â–¡ ç½‘ç»œå¸¦å®½æ»¡è¶³

è½¯ä»¶æ£€æŸ¥ï¼š
â–¡ æ“ä½œç³»ç»Ÿç‰ˆæœ¬å…¼å®¹
â–¡ MySQLç‰ˆæœ¬ä¸€è‡´
â–¡ å¿…è¦çš„ç³»ç»ŸåŒ…å·²å®‰è£…
â–¡ æ—¶é—´åŒæ­¥é…ç½®å®Œæˆ

ç½‘ç»œæ£€æŸ¥ï¼š
â–¡ ä¸»æœºåè§£ææ­£ç¡®
â–¡ ç«¯å£è¿é€šæ€§æµ‹è¯•
â–¡ é˜²ç«å¢™è§„åˆ™é…ç½®
â–¡ SSLè¯ä¹¦å‡†å¤‡å®Œæˆ

æƒé™æ£€æŸ¥ï¼š
â–¡ MySQLç”¨æˆ·åˆ›å»ºå®Œæˆ
â–¡ æ–‡ä»¶ç³»ç»Ÿæƒé™æ­£ç¡®
â–¡ æ•°æ®ç›®å½•æƒé™è®¾ç½®
â–¡ æ—¥å¿—ç›®å½•æƒé™è®¾ç½®
```

### 7.2 è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬


**ğŸ¤– éƒ¨ç½²è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# InnoDB Clusterè‡ªåŠ¨éƒ¨ç½²è„šæœ¬

set -e

# é…ç½®å˜é‡
CLUSTER_NAME="production_cluster"
NODE_LIST=("mysql-node1" "mysql-node2" "mysql-node3")
MYSQL_ROOT_PASSWORD="RootPassword123!"
CLUSTER_PASSWORD="ClusterPassword123!"

# å‡½æ•°ï¼šæ£€æŸ¥èŠ‚ç‚¹è¿é€šæ€§
check_connectivity() {
    for node in "${NODE_LIST[@]}"; do
        echo "æ£€æŸ¥èŠ‚ç‚¹ $node è¿é€šæ€§..."
        if ! ping -c 1 "$node" > /dev/null; then
            echo "é”™è¯¯ï¼šæ— æ³•è¿æ¥åˆ°èŠ‚ç‚¹ $node"
            exit 1
        fi
    done
    echo "æ‰€æœ‰èŠ‚ç‚¹è¿é€šæ€§æ£€æŸ¥é€šè¿‡"
}

# å‡½æ•°ï¼šé…ç½®å•ä¸ªèŠ‚ç‚¹
configure_node() {
    local node=$1
    local server_id=$2
    
    echo "é…ç½®èŠ‚ç‚¹ $node (server_id: $server_id)..."
    
    # ç”Ÿæˆé…ç½®æ–‡ä»¶
    ssh "$node" "sudo tee /etc/mysql/mysql.conf.d/cluster.cnf" << EOF
[mysqld]
server_id = $server_id
bind_address = 0.0.0.0
report_host = $node
plugin_load_add = 'group_replication.so'
group_replication_group_name = "aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee"
group_replication_start_on_boot = off
group_replication_local_address = "$node:33061"
group_replication_group_seeds = "mysql-node1:33061,mysql-node2:33061,mysql-node3:33061"
EOF

    # é‡å¯MySQLæœåŠ¡
    ssh "$node" "sudo systemctl restart mysql"
    echo "èŠ‚ç‚¹ $node é…ç½®å®Œæˆ"
}

# ä¸»éƒ¨ç½²æµç¨‹
main() {
    echo "å¼€å§‹InnoDB Clusteréƒ¨ç½²..."
    
    # 1. æ£€æŸ¥ç¯å¢ƒ
    check_connectivity
    
    # 2. é…ç½®æ‰€æœ‰èŠ‚ç‚¹
    for i in "${!NODE_LIST[@]}"; do
        configure_node "${NODE_LIST[$i]}" $((i + 1))
    done
    
    # 3. åˆ›å»ºé›†ç¾¤
    mysql_shell_script="
    shell.connect('root@${NODE_LIST[0]}:3306', '$MYSQL_ROOT_PASSWORD')
    dba.createCluster('$CLUSTER_NAME')
    var cluster = dba.getCluster('$CLUSTER_NAME')
    cluster.addInstance('root@${NODE_LIST[1]}:3306')
    cluster.addInstance('root@${NODE_LIST[2]}:3306')
    cluster.status()
    "
    
    echo "$mysql_shell_script" | mysqlsh --no-wizard
    
    echo "InnoDB Clusteréƒ¨ç½²å®Œæˆï¼"
}

# æ‰§è¡Œä¸»æµç¨‹
main "$@"
```

### 7.3 éƒ¨ç½²éªŒè¯æµ‹è¯•


**ğŸ§ª éªŒè¯æµ‹è¯•æµç¨‹**ï¼š
```bash
#!/bin/bash
# é›†ç¾¤éƒ¨ç½²éªŒè¯è„šæœ¬

# 1. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
echo "=== æ£€æŸ¥é›†ç¾¤çŠ¶æ€ ==="
mysqlsh --uri clusteradmin@mysql-node1 --password <<EOF
var cluster = dba.getCluster()
cluster.status()
EOF

# 2. æµ‹è¯•æ•…éšœåˆ‡æ¢
echo "=== æµ‹è¯•æ•…éšœåˆ‡æ¢ ==="
# æ¨¡æ‹Ÿä¸»èŠ‚ç‚¹æ•…éšœ
sudo systemctl stop mysql@mysql-node1

# ç­‰å¾…è‡ªåŠ¨åˆ‡æ¢
sleep 30

# æ£€æŸ¥æ–°çš„ä¸»èŠ‚ç‚¹
mysqlsh --uri clusteradmin@mysql-node2 --password <<EOF
var cluster = dba.getCluster()
cluster.status()
EOF

# 3. æµ‹è¯•æ•°æ®ä¸€è‡´æ€§
echo "=== æµ‹è¯•æ•°æ®ä¸€è‡´æ€§ ==="
mysql -h mysql-node2 -u testuser -p <<EOF
CREATE DATABASE test_consistency;
USE test_consistency;
CREATE TABLE test_table (id INT, data VARCHAR(100));
INSERT INTO test_table VALUES (1, 'test data');
EOF

# åœ¨ä»èŠ‚ç‚¹éªŒè¯æ•°æ®
mysql -h mysql-node3 -u testuser -p <<EOF
USE test_consistency;
SELECT * FROM test_table;
EOF
```

---

## 8. ğŸŒŸ ç°ä»£åŒ–éƒ¨ç½²ç­–ç•¥


### 8.1 äº‘ç¯å¢ƒä¸‹çš„éƒ¨ç½²ç­–ç•¥


**â˜ï¸ äº‘å¹³å°éƒ¨ç½²è€ƒè™‘**ï¼š

#### AWS RDS for MySQLé›†ç¾¤

```yaml
# CloudFormationæ¨¡æ¿ç¤ºä¾‹
Resources:
  MySQLCluster:
    Type: AWS::RDS::DBCluster
    Properties:
      Engine: aurora-mysql
      MasterUsername: admin
      MasterUserPassword: !Ref DBPassword
      DatabaseName: production
      VpcSecurityGroupIds:
        - !Ref DBSecurityGroup
      DBSubnetGroupName: !Ref DBSubnetGroup
      BackupRetentionPeriod: 7
      PreferredBackupWindow: "03:00-04:00"
      PreferredMaintenanceWindow: "sun:04:00-sun:05:00"
```

#### é˜¿é‡Œäº‘PolarDBéƒ¨ç½²

```bash
# ä½¿ç”¨é˜¿é‡Œäº‘CLIåˆ›å»ºPolarDBé›†ç¾¤
aliyun polardb CreateDBCluster \
  --DBType MySQL \
  --DBVersion 8.0 \
  --DBNodeClass polar.mysql.x4.large \
  --DBClusterDescription "ç”Ÿäº§ç¯å¢ƒMySQLé›†ç¾¤" \
  --PayType Postpaid \
  --RegionId cn-hangzhou
```

### 8.2 å®¹å™¨åŒ–éƒ¨ç½²çš„æœ€ä½³å®è·µ


**ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²**ï¼š

#### Docker Composeé…ç½®

```yaml
version: '3.8'
services:
  mysql-node1:
    image: mysql:8.0
    container_name: mysql-cluster-node1
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_USER: clusteruser
      MYSQL_PASSWORD: clusterpass
    volumes:
      - mysql1_data:/var/lib/mysql
      - ./config/node1.cnf:/etc/mysql/mysql.conf.d/cluster.cnf
    networks:
      - mysql_cluster
    ports:
      - "3301:3306"
      - "33061:33061"

  mysql-node2:
    image: mysql:8.0  
    container_name: mysql-cluster-node2
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_USER: clusteruser
      MYSQL_PASSWORD: clusterpass
    volumes:
      - mysql2_data:/var/lib/mysql
      - ./config/node2.cnf:/etc/mysql/mysql.conf.d/cluster.cnf
    networks:
      - mysql_cluster
    ports:
      - "3302:3306"
      - "33062:33061"

  mysql-router:
    image: mysql/mysql-router:8.0
    container_name: mysql-router
    environment:
      MYSQL_HOST: mysql-node1
      MYSQL_PORT: 3306
      MYSQL_USER: clusteruser
      MYSQL_PASSWORD: clusterpass
    depends_on:
      - mysql-node1
      - mysql-node2
    networks:
      - mysql_cluster
    ports:
      - "6446:6446"
      - "6447:6447"

volumes:
  mysql1_data:
  mysql2_data:

networks:
  mysql_cluster:
    driver: bridge
```

#### Kuberneteséƒ¨ç½²é…ç½®

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql-cluster
spec:
  serviceName: mysql
  replicas: 3
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: root-password
        ports:
        - containerPort: 3306
          name: mysql
        - containerPort: 33061
          name: gr-port
        volumeMounts:
        - name: mysql-storage
          mountPath: /var/lib/mysql
        - name: mysql-config
          mountPath: /etc/mysql/mysql.conf.d
  volumeClaimTemplates:
  - metadata:
      name: mysql-storage
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 100Gi
```

### 8.3 å¤šåœ°åŸŸéƒ¨ç½²çš„ç½‘ç»œä¼˜åŒ–


**ğŸŒ åœ°ç†åˆ†å¸ƒå¼éƒ¨ç½²**ï¼š

#### ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–

```
åœ°åŸŸéƒ¨ç½²ç­–ç•¥ï¼š
åŒ—äº¬æœºæˆ¿ â†â†’ ä¸Šæµ·æœºæˆ¿ â†â†’ æ·±åœ³æœºæˆ¿
   |            |           |
[ä¸»èŠ‚ç‚¹]    [ä»èŠ‚ç‚¹1]   [ä»èŠ‚ç‚¹2]

ç½‘ç»œä¼˜åŒ–æªæ–½ï¼š
âœ… ä½¿ç”¨ä¸“çº¿è¿æ¥ï¼Œå‡å°‘å…¬ç½‘å»¶è¿Ÿ
âœ… é…ç½®åˆé€‚çš„è¶…æ—¶å‚æ•°
âœ… å¯ç”¨ç½‘ç»œå‹ç¼©å‡å°‘ä¼ è¾“é‡
âœ… ä½¿ç”¨å°±è¿‘è¯»ç­–ç•¥å‡å°‘è·¨åŒºåŸŸè®¿é—®
```

#### è·¨åœ°åŸŸé…ç½®ä¼˜åŒ–

```ini
# é’ˆå¯¹é«˜å»¶è¿Ÿç½‘ç»œçš„Group Replicationé…ç½®
group_replication_member_expel_timeout = 60
group_replication_unreachable_majority_timeout = 120
group_replication_message_cache_size = 2G

# ç½‘ç»œå‹ç¼©é…ç½®
group_replication_compression_threshold = 100000
slave_compressed_protocol = ON
```

---

## 9. ğŸ› ï¸ è¿ç»´è§„èŒƒä¸å·¥å…·


### 9.1 è¿ç»´è§„èŒƒåˆ¶å®š


**ğŸ“‹ æ—¥å¸¸è¿ç»´è§„èŒƒ**ï¼š

#### ç›‘æ§æ£€æŸ¥è§„èŒƒ

```bash
#!/bin/bash
# æ¯æ—¥å¥åº·æ£€æŸ¥è„šæœ¬

# 1. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
echo "=== é›†ç¾¤çŠ¶æ€æ£€æŸ¥ ==="
mysqlsh --uri monitor@mysql-router:6446 --password <<EOF
var cluster = dba.getCluster()
print(cluster.status())
EOF

# 2. æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
echo "=== å¤åˆ¶å»¶è¿Ÿæ£€æŸ¥ ==="
mysql -h mysql-router -P 6447 -u monitor -p <<EOF
SELECT 
    member_host,
    count_transactions_in_queue as pending_transactions,
    count_transactions_checked as applied_transactions
FROM performance_schema.replication_group_member_stats;
EOF

# 3. æ£€æŸ¥é”™è¯¯æ—¥å¿—
echo "=== é”™è¯¯æ—¥å¿—æ£€æŸ¥ ==="
for node in mysql-node1 mysql-node2 mysql-node3; do
    echo "æ£€æŸ¥èŠ‚ç‚¹ $node é”™è¯¯æ—¥å¿—..."
    ssh "$node" "tail -20 /var/log/mysql/error.log | grep -i error"
done

# 4. æ£€æŸ¥ç£ç›˜ç©ºé—´
echo "=== ç£ç›˜ç©ºé—´æ£€æŸ¥ ==="
for node in mysql-node1 mysql-node2 mysql-node3; do
    echo "èŠ‚ç‚¹ $node ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
    ssh "$node" "df -h /var/lib/mysql"
done
```

#### å¤‡ä»½ç­–ç•¥è§„èŒƒ

```bash
#!/bin/bash
# è‡ªåŠ¨å¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="cluster_backup_$DATE.sql"

# 1. åˆ›å»ºé€»è¾‘å¤‡ä»½
mysqldump -h mysql-router -P 6447 \
  --single-transaction \
  --routines \
  --triggers \
  --all-databases > "$BACKUP_DIR/$BACKUP_FILE"

# 2. å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip "$BACKUP_DIR/$BACKUP_FILE"

# 3. ä¸Šä¼ åˆ°è¿œç¨‹å­˜å‚¨
aws s3 cp "$BACKUP_DIR/$BACKUP_FILE.gz" \
  s3://mysql-backups/daily/

# 4. æ¸…ç†æœ¬åœ°æ—§å¤‡ä»½ï¼ˆä¿ç•™7å¤©ï¼‰
find "$BACKUP_DIR" -name "*.gz" -mtime +7 -delete

echo "å¤‡ä»½å®Œæˆï¼š$BACKUP_FILE.gz"
```

### 9.2 æ™ºèƒ½åŒ–è¿ç»´å·¥å…·é›†æˆ


**ğŸ¤– è¿ç»´å·¥å…·ç”Ÿæ€**ï¼š

#### Prometheusç›‘æ§é›†æˆ

```yaml
# prometheus.ymlé…ç½®
scrape_configs:
  - job_name: 'mysql-cluster'
    static_configs:
      - targets: 
        - 'mysql-node1:9104'
        - 'mysql-node2:9104'
        - 'mysql-node3:9104'
    scrape_interval: 30s
    metrics_path: /metrics

  - job_name: 'mysql-router'
    static_configs:
      - targets: ['mysql-router:8443']
    scrape_interval: 30s
```

#### Grafanaä»ªè¡¨ç›˜é…ç½®

```json
{
  "dashboard": {
    "title": "MySQL InnoDB Clusterç›‘æ§",
    "panels": [
      {
        "title": "é›†ç¾¤çŠ¶æ€",
        "type": "stat",
        "targets": [
          {
            "expr": "mysql_global_status_wsrep_cluster_size",
            "legendFormat": "é›†ç¾¤èŠ‚ç‚¹æ•°"
          }
        ]
      },
      {
        "title": "QPSç»Ÿè®¡", 
        "type": "graph",
        "targets": [
          {
            "expr": "rate(mysql_global_status_questions[5m])",
            "legendFormat": "{{instance}} QPS"
          }
        ]
      }
    ]
  }
}
```

### 9.3 æ™ºèƒ½åŒ–éƒ¨ç½²ç³»ç»Ÿ


**ğŸ§  è‡ªåŠ¨åŒ–è¿ç»´å¹³å°**ï¼š

#### åŸºäºAnsibleçš„è‡ªåŠ¨åŒ–

```yaml
# playbook.yml
---
- name: Deploy MySQL InnoDB Cluster
  hosts: mysql_nodes
  become: yes
  vars:
    mysql_version: "8.0"
    cluster_name: "production_cluster"
    
  tasks:
    - name: Install MySQL
      apt:
        name: "mysql-server-{{ mysql_version }}"
        state: present
        
    - name: Configure MySQL
      template:
        src: mysql.cnf.j2
        dest: /etc/mysql/mysql.conf.d/cluster.cnf
      notify: restart mysql
      
    - name: Create cluster users
      mysql_user:
        name: "{{ item.name }}"
        password: "{{ item.password }}"
        priv: "{{ item.priv }}"
        host: "{{ item.host }}"
      loop:
        - { name: "clusteradmin", password: "{{ cluster_password }}", priv: "*.*:ALL", host: "%" }
        - { name: "appuser", password: "{{ app_password }}", priv: "app_db.*:SELECT,INSERT,UPDATE,DELETE", host: "%" }
        
  handlers:
    - name: restart mysql
      systemd:
        name: mysql
        state: restarted
```

#### åŸºäºTerraformçš„åŸºç¡€è®¾æ–½å³ä»£ç 

```hcl
# main.tf
resource "aws_rds_cluster" "mysql_cluster" {
  cluster_identifier = "mysql-cluster-prod"
  engine             = "aurora-mysql"
  engine_version     = "8.0.mysql_aurora.3.02.0"
  database_name      = "production"
  master_username    = var.master_username
  master_password    = var.master_password
  
  backup_retention_period = 7
  preferred_backup_window = "03:00-04:00"
  
  vpc_security_group_ids = [aws_security_group.mysql_cluster.id]
  db_subnet_group_name   = aws_db_subnet_group.mysql_cluster.name
  
  enabled_cloudwatch_logs_exports = ["error", "general", "slowquery"]
  
  tags = {
    Environment = "production"
    Team        = "database"
  }
}

resource "aws_rds_cluster_instance" "mysql_cluster_instances" {
  count              = 3
  identifier         = "mysql-cluster-instance-${count.index}"
  cluster_identifier = aws_rds_cluster.mysql_cluster.id
  instance_class     = "db.r6g.large"
  engine             = aws_rds_cluster.mysql_cluster.engine
  engine_version     = aws_rds_cluster.mysql_cluster.engine_version
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ InnoDB Clusteræ¶æ„ï¼šMySQL Group Replication + MySQL Router + MySQL Shell
ğŸ”¸ é›†ç¾¤è§’è‰²ï¼šPrimaryèŠ‚ç‚¹å¤„ç†å†™æ“ä½œï¼ŒSecondaryèŠ‚ç‚¹å¤„ç†è¯»æ“ä½œ
ğŸ”¸ é«˜å¯ç”¨æœºåˆ¶ï¼šè‡ªåŠ¨æ•…éšœæ£€æµ‹ã€ä¸»èŠ‚ç‚¹é€‰ä¸¾ã€æµé‡è‡ªåŠ¨åˆ‡æ¢
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šæ‰€æœ‰èŠ‚ç‚¹åº”ç”¨ç›¸åŒäº‹åŠ¡ï¼Œå¤šæ•°æŠ•ç¥¨æœºåˆ¶
ğŸ”¸ éƒ¨ç½²è¦ç´ ï¼šç¡¬ä»¶è§„åˆ’ã€ç½‘ç»œè®¾è®¡ã€å®‰å…¨é…ç½®ã€æ€§èƒ½è°ƒä¼˜
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é›†ç¾¤è§„æ¨¡é€‰æ‹©**ï¼š
```
ç”Ÿäº§ç¯å¢ƒæ¨èï¼š
â€¢ æœ€å°3èŠ‚ç‚¹ï¼šå®¹å¿1ä¸ªæ•…éšœ
â€¢ æ¨è5èŠ‚ç‚¹ï¼šå®¹å¿2ä¸ªæ•…éšœï¼Œæ€§èƒ½æ›´ç¨³å®š
â€¢ è¶…è¿‡7èŠ‚ç‚¹ï¼šç®¡ç†å¤æ‚åº¦å¢åŠ ï¼Œéœ€è¦æƒè¡¡
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–é‡ç‚¹**ï¼š
```
ç¡¬ä»¶å±‚é¢ï¼š
â€¢ SSDå­˜å‚¨æå‡I/Oæ€§èƒ½
â€¢ å……è¶³å†…å­˜æ”¯æŒInnoDBç¼“å†²æ± 
â€¢ é«˜é€Ÿç½‘ç»œå‡å°‘å¤åˆ¶å»¶è¿Ÿ

è½¯ä»¶å±‚é¢ï¼š
â€¢ InnoDBå‚æ•°é’ˆå¯¹æ€§è°ƒä¼˜
â€¢ Group Replicationæµæ§é…ç½®
â€¢ è¿æ¥æ± å’Œå¹¶å‘å‚æ•°ä¼˜åŒ–
```

**ğŸ”¹ è¿ç»´å…³é”®ç‚¹**ï¼š
```
ç›‘æ§æŒ‡æ ‡ï¼š
â€¢ é›†ç¾¤æˆå‘˜çŠ¶æ€å’Œè§’è‰²
â€¢ å¤åˆ¶å»¶è¿Ÿå’Œé˜Ÿåˆ—é•¿åº¦
â€¢ ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

å¤‡ä»½ç­–ç•¥ï¼š
â€¢ é€»è¾‘å¤‡ä»½ï¼šæ•°æ®å®Œæ•´æ€§ä¿è¯
â€¢ ç‰©ç†å¤‡ä»½ï¼šå¿«é€Ÿæ¢å¤èƒ½åŠ›
â€¢ è¿œç¨‹å­˜å‚¨ï¼šç¾éš¾æ¢å¤ä¿éšœ
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


- **é«˜å¯ç”¨ä¿éšœ**ï¼šè‡ªåŠ¨æ•…éšœåˆ‡æ¢ï¼Œä¸šåŠ¡è¿ç»­æ€§ä¿è¯
- **æ€§èƒ½æå‡**ï¼šè¯»å†™åˆ†ç¦»ï¼Œè´Ÿè½½åˆ†æ‹…æå‡ååé‡
- **æ‰©å±•èƒ½åŠ›**ï¼šæ°´å¹³æ‰©å±•è¯»èƒ½åŠ›ï¼Œåº”å¯¹ä¸šåŠ¡å¢é•¿
- **è¿ç»´ç®€åŒ–**ï¼šè‡ªåŠ¨åŒ–å·¥å…·å‡å°‘äººå·¥å¹²é¢„
- **æˆæœ¬ä¼˜åŒ–**ï¼šäº‘åŸç”Ÿéƒ¨ç½²ï¼ŒæŒ‰éœ€å¼¹æ€§æ‰©å±•

**ğŸ¯ éƒ¨ç½²æˆåŠŸçš„å…³é”®è¦ç´ **ï¼š
- **å……åˆ†çš„å‰æœŸè§„åˆ’**ï¼šç¡¬ä»¶ã€ç½‘ç»œã€å®¹é‡è¯„ä¼°
- **æ ‡å‡†åŒ–çš„éƒ¨ç½²æµç¨‹**ï¼šè‡ªåŠ¨åŒ–è„šæœ¬ã€é…ç½®æ¨¡æ¿
- **å®Œå–„çš„ç›‘æ§ä½“ç³»**ï¼šå®æ—¶çŠ¶æ€ç›‘æ§ã€å‘Šè­¦æœºåˆ¶
- **è§„èŒƒçš„è¿ç»´åˆ¶åº¦**ï¼šæ—¥å¸¸æ£€æŸ¥ã€å¤‡ä»½ç­–ç•¥ã€åº”æ€¥å“åº”

**æ ¸å¿ƒè®°å¿†**ï¼š
- InnoDB Cluster = é«˜å¯ç”¨ + è´Ÿè½½å‡è¡¡ + è‡ªåŠ¨ç®¡ç†
- 3èŠ‚ç‚¹èµ·æ­¥ï¼Œ5èŠ‚ç‚¹ç”Ÿäº§ï¼Œç›‘æ§è¿ç»´ä¸å¯å°‘
- ç¡¬ä»¶ç½‘ç»œæ˜¯åŸºç¡€ï¼Œé…ç½®è°ƒä¼˜æ˜¯å…³é”®ï¼Œè‡ªåŠ¨åŒ–è¿ç»´æ˜¯è¶‹åŠ¿