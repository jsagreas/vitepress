---
title: 5ã€AdminAPIæ¥å£ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [AdminAPIæ¦‚è¿°](#1-AdminAPIæ¦‚è¿°)
2. [é›†ç¾¤åˆ›å»ºæ¥å£](#2-é›†ç¾¤åˆ›å»ºæ¥å£)
3. [å®ä¾‹ç®¡ç†æ¥å£](#3-å®ä¾‹ç®¡ç†æ¥å£)
4. [é›†ç¾¤çŠ¶æ€æŸ¥è¯¢](#4-é›†ç¾¤çŠ¶æ€æŸ¥è¯¢)
5. [æ•…éšœæ¢å¤æ¥å£](#5-æ•…éšœæ¢å¤æ¥å£)
6. [æ‰¹é‡æ“ä½œä¸é«˜çº§åŠŸèƒ½](#6-æ‰¹é‡æ“ä½œä¸é«˜çº§åŠŸèƒ½)
7. [APIé”™è¯¯å¤„ç†æœºåˆ¶](#7-APIé”™è¯¯å¤„ç†æœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ AdminAPIæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯AdminAPI


**é€šä¿—ç†è§£**ï¼šAdminAPIå°±åƒæ˜¯MySQL InnoDB Clusterçš„"é¥æ§å™¨"ï¼Œé€šè¿‡è¿™ä¸ªé¥æ§å™¨ï¼Œä½ å¯ä»¥è½»æ¾åœ°åˆ›å»ºé›†ç¾¤ã€æ·»åŠ æœåŠ¡å™¨ã€æŸ¥çœ‹çŠ¶æ€ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨å»é…ç½®å¤æ‚çš„MySQLè®¾ç½®ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹åŠ¨é…ç½®æ¯å°MySQLæœåŠ¡å™¨ â†’ å¤æ‚æ˜“é”™
AdminAPIæ–¹å¼ï¼šç”¨ç®€å•å‘½ä»¤ç®¡ç†æ•´ä¸ªé›†ç¾¤ â†’ ç®€å•å¯é 

å°±åƒï¼š
ä¼ ç»Ÿ = æ‰‹åŠ¨è°ƒèŠ‚æ¯å°ç©ºè°ƒæ¸©åº¦
AdminAPI = ç”¨ä¸­å¤®æ§åˆ¶ç³»ç»Ÿç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç©ºè°ƒ
```

### 1.2 AdminAPIçš„æ ¸å¿ƒä½œç”¨


**ğŸ”¸ ä¸»è¦åŠŸèƒ½**
- **é›†ç¾¤åˆ›å»º**ï¼šä¸€é”®åˆ›å»ºInnoDB Cluster
- **èŠ‚ç‚¹ç®¡ç†**ï¼šæ·»åŠ ã€ç§»é™¤ã€é‡æ–°åŠ å…¥æœåŠ¡å™¨
- **çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶æ€
- **æ•…éšœæ¢å¤**ï¼šè‡ªåŠ¨åŒ–æ•…éšœå¤„ç†å’Œæ¢å¤
- **é…ç½®ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†é›†ç¾¤é…ç½®

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦AdminAPI**
```
é—®é¢˜åœºæ™¯ï¼š
æ‰‹åŠ¨é…ç½®3å°MySQLæœåŠ¡å™¨ç»„æˆé›†ç¾¤éœ€è¦ï¼š
1. é…ç½®MySQL Group Replication
2. è®¾ç½®ç½‘ç»œè¿æ¥å‚æ•°
3. é…ç½®æ•…éšœè½¬ç§»è§„åˆ™
4. ç›‘æ§é›†ç¾¤çŠ¶æ€
â†’ å¤æ‚åº¦é«˜ï¼Œå®¹æ˜“å‡ºé”™

AdminAPIè§£å†³æ–¹æ¡ˆï¼š
dba.createCluster('myCluster')  // ä¸€è¡Œå‘½ä»¤æå®šï¼
```

### 1.3 AdminAPIæ¶æ„ç»„æˆ


```
MySQL Shell + AdminAPI æ¶æ„ï¼š

    MySQL Shell (å®¢æˆ·ç«¯)
           |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   AdminAPI     â”‚ â† ç®¡ç†æ¥å£å±‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ MySQL Router   â”‚ â† è·¯ç”±ä»£ç†å±‚  
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ InnoDB Cluster â”‚ â† æ•°æ®å­˜å‚¨å±‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
    â”‚  â”‚Node1â”‚Node2â”‚Node3â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸš€ é›†ç¾¤åˆ›å»ºæ¥å£


### 2.1 dba.createCluster()æ ¸å¿ƒæ¥å£


**åŸºæœ¬æ¦‚å¿µ**ï¼š`dba.createCluster()`æ˜¯åˆ›å»ºInnoDB Clusterçš„æ ¸å¿ƒå‘½ä»¤ï¼Œç›¸å½“äº"ä¸€é”®å»ºç¾¤"åŠŸèƒ½ã€‚

**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```javascript
// æœ€ç®€å•çš„é›†ç¾¤åˆ›å»º
dba.createCluster('myCluster')

// å¸¦å‚æ•°çš„é›†ç¾¤åˆ›å»º
dba.createCluster('myCluster', {
    adoptFromGR: true,           // ä»ç°æœ‰Group Replicationé‡‡ç”¨
    force: false,                // æ˜¯å¦å¼ºåˆ¶åˆ›å»º
    disableClone: false,         // ç¦ç”¨å…‹éš†æ’ä»¶
    gtidSetIsComplete: false,    // GTIDé›†åˆæ˜¯å¦å®Œæ•´
    multiPrimary: false,         // æ˜¯å¦å¤šä¸»æ¨¡å¼
    memberSslMode: 'REQUIRED'    // SSLè¿æ¥æ¨¡å¼
})
```

### 2.2 åˆ›å»ºå‰çš„å‡†å¤‡å·¥ä½œ


**ğŸ“‹ å‰ç½®æ£€æŸ¥æ¸…å•**
- âœ… **æœåŠ¡å™¨æ£€æŸ¥**ï¼šç¡®ä¿MySQLæœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… **ç½‘ç»œè¿é€š**ï¼šå„èŠ‚ç‚¹é—´ç½‘ç»œäº’é€š
- âœ… **æƒé™é…ç½®**ï¼šå…·å¤‡é›†ç¾¤ç®¡ç†æƒé™
- âœ… **é…ç½®æ£€æŸ¥**ï¼šMySQLé…ç½®ç¬¦åˆè¦æ±‚

```javascript
// æ£€æŸ¥å®ä¾‹æ˜¯å¦å‡†å¤‡å°±ç»ª
dba.checkInstanceConfiguration('mysql://user@host:port')

// é…ç½®å®ä¾‹ä¸ºé›†ç¾¤åšå‡†å¤‡
dba.configureInstance('mysql://user@host:port')
```

### 2.3 åˆ›å»ºè¿‡ç¨‹è¯¦è§£


**ğŸ”„ åˆ›å»ºæµç¨‹**
```
ç¬¬1æ­¥ï¼šéªŒè¯å½“å‰å®ä¾‹é…ç½®
       â†“
ç¬¬2æ­¥ï¼šåˆå§‹åŒ–Group Replication
       â†“  
ç¬¬3æ­¥ï¼šåˆ›å»ºé›†ç¾¤å…ƒæ•°æ®
       â†“
ç¬¬4æ­¥ï¼šé…ç½®é›†ç¾¤å‚æ•°
       â†“
ç¬¬5æ­¥ï¼šå¯åŠ¨é›†ç¾¤æœåŠ¡
       â†“
ç¬¬6æ­¥ï¼šè¿”å›é›†ç¾¤å¯¹è±¡
```

**ğŸ’» å®é™…æ“ä½œç¤ºä¾‹**
```javascript
// è¿æ¥åˆ°MySQLå®ä¾‹
\connect root@mysql-node1:3306

// åˆ›å»ºé›†ç¾¤
var cluster = dba.createCluster('prodCluster', {
    adoptFromGR: false,
    multiPrimary: false,
    force: false
})

// åˆ›å»ºæˆåŠŸåçš„è¾“å‡º
/*
A new InnoDB cluster will be created on instance 'mysql-node1:3306'.

Validating instance configuration at mysql-node1:3306...
Instance configuration is suitable.
Creating InnoDB cluster 'prodCluster' on 'mysql-node1:3306'...

Adding Seed Instance...
Cluster successfully created. Use Cluster.addInstance() to add MySQL instances.
*/
```

---

## 3. âš™ï¸ å®ä¾‹ç®¡ç†æ¥å£


### 3.1 cluster.addInstance()æ·»åŠ å®ä¾‹


**é€šä¿—ç†è§£**ï¼šå°±åƒå¾€å¾®ä¿¡ç¾¤é‡ŒåŠ äººä¸€æ ·ï¼ŒæŠŠæ–°çš„MySQLæœåŠ¡å™¨åŠ å…¥åˆ°é›†ç¾¤ä¸­ã€‚

**ğŸ”¸ åŸºæœ¬ç”¨æ³•**
```javascript
// è·å–é›†ç¾¤å¯¹è±¡
var cluster = dba.getCluster('myCluster')

// æ·»åŠ æ–°å®ä¾‹
cluster.addInstance('mysql://user@newnode:3306')

// å¸¦å‚æ•°æ·»åŠ 
cluster.addInstance('mysql://user@newnode:3306', {
    password: 'password',        // è¿æ¥å¯†ç 
    recoveryMethod: 'clone',     // æ•°æ®æ¢å¤æ–¹æ³•
    waitRecovery: 1,            // ç­‰å¾…æ¢å¤å®Œæˆ(0=ä¸ç­‰å¾…,1=ç­‰å¾…,2=ç­‰å¾…å¹¶æ˜¾ç¤ºè¿›åº¦)
    label: 'node2'              // å®ä¾‹æ ‡ç­¾
})
```

### 3.2 æ•°æ®æ¢å¤æ–¹æ³•å¯¹æ¯”


| æ¢å¤æ–¹æ³• | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **æ¨èåº¦** |
|---------|------------|---------|---------|-----------|
| `clone` | **æ•°æ®é‡å¤§ï¼Œç½‘ç»œå¥½** | `å¿«é€Ÿï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦é«˜` | `éœ€è¦MySQL 8.0.17+` | `ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥` |
| `incremental` | **æ•°æ®é‡å°ï¼Œå¢é‡åŒæ­¥** | `èŠ‚çœç½‘ç»œå¸¦å®½` | `å¯èƒ½è€—æ—¶è¾ƒé•¿` | `ğŸ”¥ğŸ”¥ğŸ”¥â˜†â˜†` |
| `manual` | **ç‰¹æ®Šæƒ…å†µï¼Œæ‰‹åŠ¨æ§åˆ¶** | `å®Œå…¨å¯æ§` | `éœ€è¦æ‰‹åŠ¨æ“ä½œ` | `ğŸ”¥ğŸ”¥â˜†â˜†â˜†` |

### 3.3 cluster.removeInstance()ç§»é™¤å®ä¾‹


**åº”ç”¨åœºæ™¯**ï¼š
- ğŸ”§ **æœåŠ¡å™¨ç»´æŠ¤**ï¼šä¸´æ—¶ç§»é™¤è¿›è¡Œç¡¬ä»¶ç»´æŠ¤
- ğŸ”„ **æ¶æ„è°ƒæ•´**ï¼šå‡å°‘é›†ç¾¤è§„æ¨¡
- âš ï¸ **æ•…éšœå¤„ç†**ï¼šç§»é™¤æ•…éšœæ— æ³•æ¢å¤çš„èŠ‚ç‚¹

```javascript
// ä¼˜é›…ç§»é™¤å®ä¾‹
cluster.removeInstance('mysql://user@node2:3306')

// å¼ºåˆ¶ç§»é™¤ï¼ˆèŠ‚ç‚¹æ— æ³•è®¿é—®æ—¶ï¼‰
cluster.removeInstance('mysql://user@node2:3306', {
    force: true
})

// ç§»é™¤è¿‡ç¨‹ç¤ºä¾‹è¾“å‡º
/*
The instance will be removed from the InnoDB cluster.
* Waiting for instance 'node2:3306' to synchronize with the primary...
* Instance 'node2:3306' is attempting to leave the cluster...
* Instance 'node2:3306' was successfully removed from the cluster.
*/
```

---

## 4. ğŸ“Š é›†ç¾¤çŠ¶æ€æŸ¥è¯¢


### 4.1 cluster.status()çŠ¶æ€æŸ¥è¯¢


**é€šä¿—ç†è§£**ï¼šå°±åƒæŸ¥çœ‹å¾®ä¿¡ç¾¤æˆå‘˜åˆ—è¡¨ä¸€æ ·ï¼Œçœ‹çœ‹é›†ç¾¤é‡Œæœ‰å“ªäº›æœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€å¦‚ä½•ã€‚

**ğŸ”¸ åŸºæœ¬æŸ¥è¯¢**
```javascript
// åŸºæœ¬çŠ¶æ€æŸ¥è¯¢
var cluster = dba.getCluster('myCluster')
cluster.status()

// è¯¦ç»†çŠ¶æ€æŸ¥è¯¢
cluster.status({extended: 1})   // 0=åŸºæœ¬ä¿¡æ¯, 1=è¯¦ç»†ä¿¡æ¯, 2=å®Œæ•´ä¿¡æ¯
cluster.status({queryMembers: true})  // æŸ¥è¯¢æ‰€æœ‰æˆå‘˜è¯¦ç»†ä¿¡æ¯
```

### 4.2 çŠ¶æ€ä¿¡æ¯è§£è¯»


**ğŸ“‹ é›†ç¾¤çŠ¶æ€å«ä¹‰**
```json
{
    "clusterName": "myCluster",
    "defaultReplicaSet": {
        "name": "default", 
        "primary": "mysql-node1:3306",
        "ssl": "REQUIRED",
        "status": "OK",                    // é›†ç¾¤æ•´ä½“çŠ¶æ€
        "statusText": "Cluster is ONLINE and can tolerate up to ONE failure.",
        "topology": {
            "mysql-node1:3306": {
                "address": "mysql-node1:3306",
                "mode": "R/W",             // R/W=è¯»å†™, R/O=åªè¯»
                "readReplicas": {},
                "role": "HA",              // HA=é«˜å¯ç”¨èŠ‚ç‚¹
                "status": "ONLINE"         // ONLINE=åœ¨çº¿, OFFLINE=ç¦»çº¿
            },
            "mysql-node2:3306": {
                "address": "mysql-node2:3306", 
                "mode": "R/O",
                "readReplicas": {},
                "role": "HA",
                "status": "ONLINE"
            }
        }
    }
}
```

**ğŸš¨ å¸¸è§çŠ¶æ€è¯´æ˜**

| çŠ¶æ€ | **å«ä¹‰** | **å¤„ç†å»ºè®®** |
|------|---------|-------------|
| `ONLINE` | **èŠ‚ç‚¹æ­£å¸¸åœ¨çº¿** | `æ— éœ€å¤„ç†` |
| `OFFLINE` | **èŠ‚ç‚¹ç¦»çº¿** | `æ£€æŸ¥ç½‘ç»œå’ŒæœåŠ¡çŠ¶æ€` |
| `RECOVERING` | **æ•°æ®æ¢å¤ä¸­** | `ç­‰å¾…æ¢å¤å®Œæˆ` |
| `ERROR` | **èŠ‚ç‚¹é”™è¯¯** | `æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Œè€ƒè™‘é‡æ–°åŠ å…¥` |
| `UNREACHABLE` | **ç½‘ç»œä¸å¯è¾¾** | `æ£€æŸ¥ç½‘ç»œè¿æ¥` |
| `MISSING` | **èŠ‚ç‚¹ä¸¢å¤±** | `å¯èƒ½éœ€è¦å¼ºåˆ¶ç§»é™¤` |

### 4.3 è¯¦ç»†ç›‘æ§ä¿¡æ¯


```javascript
// æŸ¥çœ‹é›†ç¾¤å®Œæ•´ä¿¡æ¯
cluster.status({extended: 2})

// è¾“å‡ºåŒ…å«çš„é¢å¤–ä¿¡æ¯ï¼š
/*
- äº‹åŠ¡å»¶è¿Ÿç»Ÿè®¡
- Group Replicationé…ç½®
- å®ä¾‹è¿æ¥ä¿¡æ¯
- æ€§èƒ½ç›‘æ§æ•°æ®
- é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯
*/

// æŸ¥çœ‹ç‰¹å®šå®ä¾‹çš„è¯¦ç»†ä¿¡æ¯
cluster.describe()  // é›†ç¾¤é…ç½®æè¿°
```

---

## 5. ğŸ”„ æ•…éšœæ¢å¤æ¥å£


### 5.1 cluster.rejoinInstance()é‡æ–°åŠ å…¥


**ä½¿ç”¨åœºæ™¯**ï¼šå½“æŸä¸ªèŠ‚ç‚¹å› ä¸ºç½‘ç»œä¸­æ–­ã€æœåŠ¡é‡å¯ç­‰åŸå› æ‰çº¿åï¼Œéœ€è¦é‡æ–°åŠ å…¥é›†ç¾¤ã€‚

**ğŸ”¸ åŸºæœ¬é‡æ–°åŠ å…¥**
```javascript
// ç®€å•é‡æ–°åŠ å…¥
cluster.rejoinInstance('mysql://user@node2:3306')

// å¸¦é€‰é¡¹çš„é‡æ–°åŠ å…¥
cluster.rejoinInstance('mysql://user@node2:3306', {
    password: 'password',
    memberSslMode: 'REQUIRED',
    ipWhitelist: '192.168.1.0/24'
})
```

### 5.2 è‡ªåŠ¨æ•…éšœæ£€æµ‹ä¸å¤„ç†


**ğŸ” æ•…éšœæ£€æµ‹æœºåˆ¶**
```
ç½‘ç»œç›‘æ§ï¼šæ¯éš”5ç§’æ£€æŸ¥èŠ‚ç‚¹è¿é€šæ€§
    â†“
æœåŠ¡ç›‘æ§ï¼šæ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
    â†“
æ•°æ®åŒæ­¥ç›‘æ§ï¼šæ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
    â†“
è‡ªåŠ¨å¤„ç†ï¼šæ ¹æ®æ•…éšœç±»å‹é‡‡å–å¯¹åº”æªæ–½
```

**âš¡ è‡ªåŠ¨æ¢å¤æµç¨‹**
```javascript
// MySQL Shellä¼šè‡ªåŠ¨å°è¯•æ¢å¤ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘
dba.rebootClusterFromCompleteOutage('myCluster')

// æ£€æŸ¥å¹¶ä¿®å¤é›†ç¾¤
cluster.rescan()  // é‡æ–°æ‰«æé›†ç¾¤æ‹“æ‰‘
cluster.forceQuorumUsingPartitionOf('mysql://user@node1:3306')  // å¼ºåˆ¶ä»²è£
```

### 5.3 å¸¸è§æ•…éšœå¤„ç†åœºæ™¯


**ğŸ“ æ•…éšœå¤„ç†æŒ‡å—**

| æ•…éšœç±»å‹ | **ç—‡çŠ¶** | **å¤„ç†æ–¹æ³•** | **å‘½ä»¤ç¤ºä¾‹** |
|---------|---------|-------------|-------------|
| **å•èŠ‚ç‚¹ç¦»çº¿** | `statusæ˜¾ç¤ºOFFLINE` | `æ£€æŸ¥æœåŠ¡ï¼Œé‡æ–°åŠ å…¥` | `cluster.rejoinInstance()` |
| **ç½‘ç»œåˆ†åŒº** | `éƒ¨åˆ†èŠ‚ç‚¹UNREACHABLE` | `ä¿®å¤ç½‘ç»œï¼Œå¼ºåˆ¶ä»²è£` | `cluster.forceQuorum()` |
| **å…¨é›†ç¾¤å®•æœº** | `æ‰€æœ‰èŠ‚ç‚¹ç¦»çº¿` | `ä»å®Œå…¨æ•…éšœä¸­é‡å¯` | `dba.rebootClusterFromCompleteOutage()` |
| **æ•°æ®ä¸ä¸€è‡´** | `å¤åˆ¶å»¶è¿Ÿè¿‡å¤§` | `é‡æ–°åŒæ­¥æ•°æ®` | `cluster.rescan()` |

```javascript
// ç¤ºä¾‹ï¼šå¤„ç†å•èŠ‚ç‚¹æ•…éšœ
// 1. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
cluster.status()

// 2. å¦‚æœèŠ‚ç‚¹æ˜¾ç¤ºOFFLINEï¼Œå°è¯•é‡æ–°åŠ å…¥
cluster.rejoinInstance('mysql://user@problem-node:3306')

// 3. å¦‚æœé‡æ–°åŠ å…¥å¤±è´¥ï¼Œæ£€æŸ¥è¯¦ç»†é”™è¯¯
cluster.status({extended: 1})

// 4. å¿…è¦æ—¶ç§»é™¤å¹¶é‡æ–°æ·»åŠ 
cluster.removeInstance('mysql://user@problem-node:3306', {force: true})
cluster.addInstance('mysql://user@problem-node:3306')
```

---

## 6. ğŸ”§ æ‰¹é‡æ“ä½œä¸é«˜çº§åŠŸèƒ½


### 6.1 æ‰¹é‡å®ä¾‹ç®¡ç†


**é€šä¿—ç†è§£**ï¼šå°±åƒæ‰¹é‡ç®¡ç†å¾®ä¿¡å¥½å‹ä¸€æ ·ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å¯¹å¤šä¸ªMySQLå®ä¾‹è¿›è¡Œæ“ä½œã€‚

**ğŸ”¸ æ‰¹é‡æ·»åŠ å®ä¾‹**
```javascript
// å®šä¹‰è¦æ·»åŠ çš„å®ä¾‹åˆ—è¡¨
var newInstances = [
    'mysql://user@node2:3306',
    'mysql://user@node3:3306', 
    'mysql://user@node4:3306'
]

// æ‰¹é‡æ·»åŠ 
newInstances.forEach(function(instance) {
    try {
        cluster.addInstance(instance, {
            recoveryMethod: 'clone',
            waitRecovery: 1
        })
        print('æˆåŠŸæ·»åŠ å®ä¾‹: ' + instance)
    } catch (error) {
        print('æ·»åŠ å®ä¾‹å¤±è´¥: ' + instance + ', é”™è¯¯: ' + error.message)
    }
})
```

### 6.2 é…ç½®å˜æ›´API


**ğŸ”¸ é›†ç¾¤é…ç½®ç®¡ç†**
```javascript
// æŸ¥çœ‹å½“å‰é…ç½®
cluster.options()

// ä¿®æ”¹é›†ç¾¤é…ç½®
cluster.setOption('clusterName', 'newClusterName')
cluster.setOption('memberWeight', 50)  // è®¾ç½®æˆå‘˜æƒé‡

// å®ä¾‹çº§åˆ«é…ç½®
cluster.setInstanceOption('mysql://user@node1:3306', 'memberWeight', 100)
cluster.setInstanceOption('mysql://user@node2:3306', 'autoRejoinTries', 3)
```

### 6.3 é›†ç¾¤æ‹“æ‰‘å˜æ›´


**ğŸ”„ åŠ¨æ€æ‰©å®¹ç¼©å®¹**
```javascript
// æ‰©å®¹ï¼šæ·»åŠ æ–°çš„å¯ç”¨åŒº
var zone2_instances = [
    'mysql://user@zone2-node1:3306',
    'mysql://user@zone2-node2:3306'
]

zone2_instances.forEach(function(instance) {
    cluster.addInstance(instance, {
        label: 'zone2-' + instance.split('@')[1].split(':')[0],
        recoveryMethod: 'clone'
    })
})

// ç¼©å®¹ï¼šç§»é™¤æ•´ä¸ªå¯ç”¨åŒº
var zone1_instances = [
    'mysql://user@zone1-node1:3306',
    'mysql://user@zone1-node2:3306'
]

zone1_instances.forEach(function(instance) {
    cluster.removeInstance(instance)
})
```

---

## 7. âš ï¸ APIé”™è¯¯å¤„ç†æœºåˆ¶


### 7.1 é”™è¯¯ç±»å‹åˆ†ç±»


**ğŸ”¸ å¸¸è§é”™è¯¯ç±»å‹**
```
è¿æ¥é”™è¯¯ï¼šæ— æ³•è¿æ¥åˆ°MySQLå®ä¾‹
é…ç½®é”™è¯¯ï¼šMySQLé…ç½®ä¸ç¬¦åˆé›†ç¾¤è¦æ±‚
æƒé™é”™è¯¯ï¼šç”¨æˆ·æƒé™ä¸è¶³
ç½‘ç»œé”™è¯¯ï¼šç½‘ç»œè¿æ¥é—®é¢˜
æ•°æ®é”™è¯¯ï¼šæ•°æ®ä¸ä¸€è‡´æˆ–æŸå
```

### 7.2 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ


**ğŸ’¡ æ ‡å‡†é”™è¯¯å¤„ç†æ¨¡å¼**
```javascript
// é”™è¯¯å¤„ç†åŒ…è£…å‡½æ•°
function safeClusterOperation(operation, ...args) {
    try {
        return operation.apply(cluster, args)
    } catch (error) {
        // è®°å½•é”™è¯¯ä¿¡æ¯
        print('æ“ä½œå¤±è´¥: ' + error.message)
        
        // æ ¹æ®é”™è¯¯ç±»å‹å†³å®šå¤„ç†ç­–ç•¥
        if (error.message.includes('timeout')) {
            print('å»ºè®®ï¼šå¢åŠ è¶…æ—¶æ—¶é—´æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥')
        } else if (error.message.includes('permission')) {
            print('å»ºè®®ï¼šæ£€æŸ¥ç”¨æˆ·æƒé™è®¾ç½®')
        } else if (error.message.includes('configuration')) {
            print('å»ºè®®ï¼šè¿è¡Œ dba.configureInstance() ä¿®å¤é…ç½®')
        }
        
        return null
    }
}

// ä½¿ç”¨ç¤ºä¾‹
var result = safeClusterOperation(cluster.addInstance, 'mysql://user@node2:3306')
if (result === null) {
    print('æ“ä½œå¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯')
}
```

### 7.3 APIæ¥å£çš„å¹‚ç­‰æ€§è®¾è®¡


**é€šä¿—ç†è§£**ï¼šå¹‚ç­‰æ€§å°±åƒæŒ‰ç”µæ¢¯æŒ‰é’®ä¸€æ ·ï¼ŒæŒ‰ä¸€æ¬¡å’ŒæŒ‰å¤šæ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚

**ğŸ”¸ å¹‚ç­‰æ€§ç¤ºä¾‹**
```javascript
// åˆ›å»ºé›†ç¾¤ - å¹‚ç­‰æ“ä½œ
try {
    var cluster = dba.createCluster('myCluster')
} catch (error) {
    if (error.message.includes('already exists')) {
        // é›†ç¾¤å·²å­˜åœ¨ï¼Œè·å–ç°æœ‰é›†ç¾¤
        var cluster = dba.getCluster('myCluster')
        print('é›†ç¾¤å·²å­˜åœ¨ï¼Œä½¿ç”¨ç°æœ‰é›†ç¾¤')
    }
}

// æ·»åŠ å®ä¾‹ - å¹‚ç­‰æ“ä½œ
function idempotentAddInstance(instanceUrl) {
    try {
        cluster.addInstance(instanceUrl)
        print('å®ä¾‹æ·»åŠ æˆåŠŸ: ' + instanceUrl)
    } catch (error) {
        if (error.message.includes('already member')) {
            print('å®ä¾‹å·²åœ¨é›†ç¾¤ä¸­: ' + instanceUrl)
        } else {
            throw error  // å…¶ä»–é”™è¯¯ç»§ç»­æŠ›å‡º
        }
    }
}
```

**âœ… å¹‚ç­‰æ€§çš„å¥½å¤„**
- **é‡å¤æ‰§è¡Œå®‰å…¨**ï¼šè„šæœ¬å¯ä»¥é‡å¤è¿è¡Œè€Œä¸å‡ºé”™
- **æ•…éšœæ¢å¤ç®€å•**ï¼šæ“ä½œå¤±è´¥åå¯ä»¥ç›´æ¥é‡è¯•
- **è‡ªåŠ¨åŒ–å‹å¥½**ï¼šé€‚åˆç¼–å†™è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¥å£


```
ğŸ”¸ é›†ç¾¤ç”Ÿå‘½å‘¨æœŸç®¡ç†
â€¢ dba.createCluster() - åˆ›å»ºæ–°é›†ç¾¤
â€¢ dba.getCluster() - è·å–ç°æœ‰é›†ç¾¤
â€¢ cluster.dissolve() - è§£æ•£é›†ç¾¤

ğŸ”¸ å®ä¾‹ç”Ÿå‘½å‘¨æœŸç®¡ç†  
â€¢ cluster.addInstance() - æ·»åŠ æ–°å®ä¾‹
â€¢ cluster.removeInstance() - ç§»é™¤å®ä¾‹
â€¢ cluster.rejoinInstance() - é‡æ–°åŠ å…¥å®ä¾‹

ğŸ”¸ çŠ¶æ€ç›‘æ§å’Œè¯Šæ–­
â€¢ cluster.status() - æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
â€¢ cluster.describe() - æŸ¥çœ‹é›†ç¾¤é…ç½®
â€¢ dba.checkInstanceConfiguration() - æ£€æŸ¥å®ä¾‹é…ç½®
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ AdminAPIçš„æœ¬è´¨ä»·å€¼**
```
ç®€åŒ–ç®¡ç†ï¼šå¤æ‚çš„é›†ç¾¤æ“ä½œå˜æˆç®€å•å‘½ä»¤
æ ‡å‡†åŒ–ï¼šç»Ÿä¸€çš„æ¥å£è§„èŒƒï¼Œå‡å°‘äººä¸ºé”™è¯¯
è‡ªåŠ¨åŒ–ï¼šæ”¯æŒè„šæœ¬åŒ–éƒ¨ç½²å’Œè¿ç»´
å¯é æ€§ï¼šå†…ç½®é”™è¯¯æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶
```

**ğŸ”¹ æ“ä½œå®‰å…¨æ€§åŸåˆ™**
```
æ£€æŸ¥å…ˆè¡Œï¼šæ“ä½œå‰å…ˆæ£€æŸ¥çŠ¶æ€å’Œé…ç½®
æ¸è¿›æ“ä½œï¼šä¸€æ¬¡åªæ“ä½œä¸€ä¸ªå®ä¾‹
é”™è¯¯å¤„ç†ï¼šæ¯ä¸ªæ“ä½œéƒ½è¦æœ‰é”™è¯¯å¤„ç†é€»è¾‘
å¹‚ç­‰è®¾è®¡ï¼šæ“ä½œå¯ä»¥å®‰å…¨é‡å¤æ‰§è¡Œ
```

**ğŸ”¹ å®é™…åº”ç”¨åœºæ™¯**
- **åˆå§‹éƒ¨ç½²**ï¼šå¿«é€Ÿæ­å»ºMySQLé›†ç¾¤ç¯å¢ƒ
- **æ—¥å¸¸è¿ç»´**ï¼šç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œå¤„ç†èŠ‚ç‚¹æ•…éšœ
- **æ‰©å®¹ç¼©å®¹**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´é›†ç¾¤è§„æ¨¡
- **æ•…éšœæ¢å¤**ï¼šè‡ªåŠ¨åŒ–æ•…éšœæ£€æµ‹å’Œæ¢å¤æµç¨‹

### 8.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ“ æ“ä½œè§„èŒƒ**
```
æ“ä½œå‰å‡†å¤‡ï¼š
âœ… å¤‡ä»½é‡è¦æ•°æ®
âœ… æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
âœ… ç¡®è®¤æƒé™é…ç½®
âœ… å‡†å¤‡å›æ»šæ–¹æ¡ˆ

æ“ä½œè¿‡ç¨‹ä¸­ï¼š
âœ… ç›‘æ§æ“ä½œè¿›åº¦
âœ… è®°å½•æ“ä½œæ—¥å¿—
âœ… åŠæ—¶å¤„ç†å¼‚å¸¸
âœ… éªŒè¯æ“ä½œç»“æœ

æ“ä½œåæ£€æŸ¥ï¼š
âœ… éªŒè¯é›†ç¾¤çŠ¶æ€
âœ… æµ‹è¯•è¯»å†™åŠŸèƒ½
âœ… æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
âœ… æ›´æ–°ç›‘æ§é…ç½®
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- AdminAPIæ˜¯ç®¡ç†InnoDB Clusterçš„æ ‡å‡†æ¥å£
- é€šè¿‡ç®€å•å‘½ä»¤å®ç°å¤æ‚çš„é›†ç¾¤ç®¡ç†æ“ä½œ
- é‡ç‚¹æŒæ¡åˆ›å»ºã€æ·»åŠ ã€çŠ¶æ€æŸ¥è¯¢ã€æ•…éšœæ¢å¤å››å¤§æ ¸å¿ƒåŠŸèƒ½
- é”™è¯¯å¤„ç†å’Œå¹‚ç­‰æ€§è®¾è®¡æ˜¯ç”Ÿäº§ç¯å¢ƒçš„å…³é”®è¦æ±‚