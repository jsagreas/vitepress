---
title: 13ã€Clusteræ•°æ®åˆ†å¸ƒç­–ç•¥
---
## ðŸ“š ç›®å½•

1. [InnoDB Clusteræ•°æ®åˆ†å¸ƒåŸºç¡€](#1-InnoDB-Clusteræ•°æ®åˆ†å¸ƒåŸºç¡€)
2. [æ•°æ®åˆ†å¸ƒç®—æ³•è¯¦è§£](#2-æ•°æ®åˆ†å¸ƒç®—æ³•è¯¦è§£)
3. [èŠ‚ç‚¹æ•°æ®å‡è¡¡æœºåˆ¶](#3-èŠ‚ç‚¹æ•°æ®å‡è¡¡æœºåˆ¶)
4. [æ•°æ®è¿ç§»ç­–ç•¥](#4-æ•°æ®è¿ç§»ç­–ç•¥)
5. [çƒ­ç‚¹æ•°æ®å¤„ç†](#5-çƒ­ç‚¹æ•°æ®å¤„ç†)
6. [æ•°æ®å±€éƒ¨æ€§ä¼˜åŒ–](#6-æ•°æ®å±€éƒ¨æ€§ä¼˜åŒ–)
7. [åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–](#7-åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–)
8. [æ•°æ®è®¿é—®æ¨¡å¼åˆ†æž](#8-æ•°æ®è®¿é—®æ¨¡å¼åˆ†æž)
9. [å­˜å‚¨åˆ©ç”¨çŽ‡ä¼˜åŒ–](#9-å­˜å‚¨åˆ©ç”¨çŽ‡ä¼˜åŒ–)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŒ InnoDB Clusteræ•°æ®åˆ†å¸ƒåŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åˆ†å¸ƒç­–ç•¥


**ðŸ”¸ ç®€å•ç†è§£**
```
å°±åƒæŠŠä¸€å †ä¹¦åˆ†é…åˆ°ä¸åŒä¹¦æž¶ä¸Šï¼š
- è¦ç¡®ä¿æ¯ä¸ªä¹¦æž¶çš„ä¹¦å·®ä¸å¤šä¸€æ ·å¤š
- ç»å¸¸è¦ç”¨çš„ä¹¦æ”¾åœ¨å®¹æ˜“æ‹¿åˆ°çš„åœ°æ–¹
- å½“æŸä¸ªä¹¦æž¶æ»¡äº†ï¼Œè¦æŠŠä¹¦æ¬åˆ°å…¶ä»–ä¹¦æž¶
```

**ðŸ“‹ æ ¸å¿ƒæ¦‚å¿µ**
- **æ•°æ®åˆ†å¸ƒ**ï¼šæŠŠæ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£å­˜å‚¨åˆ°é›†ç¾¤çš„å¤šä¸ªèŠ‚ç‚¹ä¸Š
- **è´Ÿè½½å‡è¡¡**ï¼šç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹æ‰¿æ‹…çš„æ•°æ®é‡å’Œè®¿é—®åŽ‹åŠ›ç›¸å¯¹å¹³å‡
- **æ•°æ®ä¸€è‡´æ€§**ï¼šä¿è¯åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®ä¿æŒåŒæ­¥

### 1.2 InnoDB Clusterçš„åˆ†å¸ƒæž¶æž„


**ðŸ—ï¸ é›†ç¾¤æž¶æž„ç¤ºæ„**
```
        MySQL Router (è·¯ç”±å±‚)
              |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚
Primary     Secondary  Secondary
 Node        Node      Node
 (ä¸»èŠ‚ç‚¹)    (ä»ŽèŠ‚ç‚¹)  (ä»ŽèŠ‚ç‚¹)
    â”‚         â”‚         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®A   â”‚ æ•°æ®A   â”‚ æ•°æ®A   â”‚ â† æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰å®Œæ•´æ•°æ®
â”‚ æ•°æ®B   â”‚ æ•°æ®B   â”‚ æ•°æ®B   â”‚
â”‚ æ•°æ®C   â”‚ æ•°æ®C   â”‚ æ•°æ®C   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ðŸ’¡ **é‡è¦ç†è§£**ï¼šInnoDB Clusteré‡‡ç”¨çš„æ˜¯**å…¨é‡å¤åˆ¶**æ¨¡å¼ï¼Œä¸æ˜¯æ•°æ®åˆ†ç‰‡ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜å®Œæ•´çš„æ•°æ®å‰¯æœ¬ã€‚

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åˆ†å¸ƒç­–ç•¥


**ðŸŽ¯ æ ¸å¿ƒç›®æ ‡**
```
é«˜å¯ç”¨æ€§ï¼šå•ä¸ªèŠ‚ç‚¹æ•…éšœä¸å½±å“æ•´ä½“æœåŠ¡
è¯»å†™åˆ†ç¦»ï¼šä¸»èŠ‚ç‚¹å¤„ç†å†™å…¥ï¼Œä»ŽèŠ‚ç‚¹åˆ†æ‹…è¯»å–
è´Ÿè½½å‡è¡¡ï¼šåˆç†åˆ†é…æŸ¥è¯¢è¯·æ±‚åˆ°ä¸åŒèŠ‚ç‚¹
æ€§èƒ½ä¼˜åŒ–ï¼šå°±è¿‘è®¿é—®ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿ
```

---

## 2. âš™ï¸ æ•°æ®åˆ†å¸ƒç®—æ³•è¯¦è§£


### 2.1 ç»„å¤åˆ¶çš„æ•°æ®åˆ†å¸ƒæœºåˆ¶


**ðŸ”¸ åŸºæœ¬å·¥ä½œåŽŸç†**
```
å†™å…¥æµç¨‹ï¼š
1. åº”ç”¨å‘é€å†™è¯·æ±‚åˆ°PrimaryèŠ‚ç‚¹
2. PrimaryèŠ‚ç‚¹æ‰§è¡Œäº‹åŠ¡å¹¶ç”Ÿæˆbinlog
3. é€šè¿‡Group Replicationå°†binlogå¹¿æ’­åˆ°æ‰€æœ‰SecondaryèŠ‚ç‚¹
4. æ‰€æœ‰èŠ‚ç‚¹è¾¾æˆä¸€è‡´åŽï¼Œäº‹åŠ¡æ‰ç®—å®Œæˆ

æ•°æ®åŒæ­¥ï¼š
Primary â†’ [äº‹åŠ¡æ—¥å¿—] â†’ Secondary1
      â†˜ [äº‹åŠ¡æ—¥å¿—] â†’ Secondary2
```

**ðŸ“Š ä¸€è‡´æ€§ä¿è¯ç®—æ³•**
```sql
-- MySQL Group Replicationä½¿ç”¨Paxosåè®®çš„å˜ç§
-- ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹å¯¹äº‹åŠ¡é¡ºåºè¾¾æˆä¸€è‡´

-- æŸ¥çœ‹ç»„å¤åˆ¶çŠ¶æ€
SELECT * FROM performance_schema.replication_group_members;

-- æŸ¥çœ‹ç»„å¤åˆ¶ç»Ÿè®¡ä¿¡æ¯
SELECT * FROM performance_schema.replication_group_member_stats;
```

### 2.2 æ•°æ®åˆ†å¸ƒçš„æ ¸å¿ƒç®—æ³•


**ðŸ”¸ å†™å…¥åˆ†å‘ç®—æ³•**
```
ç®—æ³•é€»è¾‘ï¼š
1. æ‰€æœ‰å†™æ“ä½œåªèƒ½åœ¨PrimaryèŠ‚ç‚¹æ‰§è¡Œ
2. PrimaryèŠ‚ç‚¹æ‰§è¡Œäº‹åŠ¡åŽï¼Œç”Ÿæˆå…¨å±€äº‹åŠ¡ID (GTID)
3. é€šè¿‡ç»„å¤åˆ¶åè®®å°†äº‹åŠ¡åŒæ­¥åˆ°æ‰€æœ‰SecondaryèŠ‚ç‚¹
4. åªæœ‰å½“å¤§å¤šæ•°èŠ‚ç‚¹ç¡®è®¤åŽï¼Œäº‹åŠ¡æ‰æäº¤
```

**ðŸ”¸ è¯»å–åˆ†å‘ç®—æ³•**
```
ç®—æ³•é€»è¾‘ï¼š
1. MySQL RouteræŽ¥æ”¶åˆ°è¯»è¯·æ±‚
2. æ ¹æ®é…ç½®çš„è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©èŠ‚ç‚¹ï¼š
   - round-robinï¼šè½®è¯¢åˆ†é…
   - least-connectionsï¼šé€‰æ‹©è¿žæŽ¥æ•°æœ€å°‘çš„èŠ‚ç‚¹
   - first-availableï¼šé€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹
3. å°†è¯·æ±‚è·¯ç”±åˆ°é€‰å®šçš„èŠ‚ç‚¹
```

---

## 3. âš–ï¸ èŠ‚ç‚¹æ•°æ®å‡è¡¡æœºåˆ¶


### 3.1 æ•°æ®åŒæ­¥ä¿è¯æœºåˆ¶


**ðŸ”¸ åŒæ­¥å¤åˆ¶ç‰¹ç‚¹**
```
å¼ºä¸€è‡´æ€§ï¼šæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®å®Œå…¨ä¸€è‡´
åŒæ­¥ç¡®è®¤ï¼šå†™å…¥éœ€è¦å¤§å¤šæ•°èŠ‚ç‚¹ç¡®è®¤
æ•…éšœæ£€æµ‹ï¼šè‡ªåŠ¨æ£€æµ‹èŠ‚ç‚¹æ•…éšœå¹¶å‰”é™¤
è‡ªåŠ¨æ¢å¤ï¼šæ•…éšœèŠ‚ç‚¹æ¢å¤åŽè‡ªåŠ¨åŒæ­¥æ•°æ®
```

**ðŸ“‹ åŒæ­¥çŠ¶æ€ç›‘æŽ§**
```sql
-- æ£€æŸ¥èŠ‚ç‚¹åŒæ­¥çŠ¶æ€
SELECT 
    MEMBER_ID,
    MEMBER_HOST,
    MEMBER_PORT,
    MEMBER_STATE,
    MEMBER_ROLE
FROM performance_schema.replication_group_members;

-- æŸ¥çœ‹å¤åˆ¶å»¶è¿Ÿ
SELECT 
    CHANNEL_NAME,
    COUNT_TRANSACTIONS_IN_QUEUE,
    COUNT_TRANSACTIONS_CHECKED,
    COUNT_CONFLICTS_DETECTED
FROM performance_schema.replication_group_member_stats;
```

### 3.2 è´Ÿè½½å‡è¡¡ç­–ç•¥


**ðŸ”¸ MySQL Routerè´Ÿè½½å‡è¡¡é…ç½®**
```ini
[routing:cluster_read]
bind_address = 0.0.0.0
bind_port = 7001
destinations = mysql-node1:3306,mysql-node2:3306,mysql-node3:3306
mode = read-only
routing_strategy = round-robin

[routing:cluster_write]
bind_address = 0.0.0.0
bind_port = 7000
mode = read-write
routing_strategy = first-available
```

**ðŸ“Š è´Ÿè½½å‡è¡¡ç­–ç•¥å¯¹æ¯”**

| ç­–ç•¥ç±»åž‹ | **å·¥ä½œæ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|---------|------------|-------------|-----------|
| ðŸ”„ **round-robin** | `è½®è¯¢åˆ†é…è¯·æ±‚åˆ°å„èŠ‚ç‚¹` | `è´Ÿè½½ç›¸å¯¹å‡åŒ€` | `ç®€å•å…¬å¹³ï¼Œä½†ä¸è€ƒè™‘èŠ‚ç‚¹æ€§èƒ½å·®å¼‚` |
| ðŸ“Š **least-connections** | `é€‰æ‹©å½“å‰è¿žæŽ¥æ•°æœ€å°‘çš„èŠ‚ç‚¹` | `è¿žæŽ¥å¤„ç†æ—¶é—´å·®å¼‚å¤§` | `åŠ¨æ€å¹³è¡¡ï¼Œä½†è®¡ç®—å¼€é”€ç¨å¤§` |
| âš¡ **first-available** | `é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹` | `å†™æ“ä½œï¼Œé«˜å¯ç”¨åœºæ™¯` | `ç®€å•å¿«é€Ÿï¼Œä½†å¯èƒ½è´Ÿè½½ä¸å‡` |

---

## 4. ðŸ”„ æ•°æ®è¿ç§»ç­–ç•¥


### 4.1 æ–°èŠ‚ç‚¹åŠ å…¥çš„æ•°æ®è¿ç§»


**ðŸ”¸ è‡ªåŠ¨æ•°æ®åŒæ­¥æµç¨‹**
```
æ–°èŠ‚ç‚¹åŠ å…¥æµç¨‹ï¼š
1. æ–°èŠ‚ç‚¹å¯åŠ¨å¹¶ç”³è¯·åŠ å…¥é›†ç¾¤
2. é›†ç¾¤éªŒè¯æ–°èŠ‚ç‚¹çš„èº«ä»½å’Œé…ç½®
3. ä»ŽçŽ°æœ‰èŠ‚ç‚¹é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ•°æ®æº
4. è¿›è¡Œå…¨é‡æ•°æ®åŒæ­¥
5. åŒæ­¥å®ŒæˆåŽï¼Œå¼€å§‹æŽ¥æ”¶å¢žé‡æ›´æ–°
6. èŠ‚ç‚¹çŠ¶æ€å˜ä¸ºONLINEï¼Œå¼€å§‹æä¾›æœåŠ¡
```

**ðŸ’» æ–°èŠ‚ç‚¹åŠ å…¥é…ç½®ç¤ºä¾‹**
```sql
-- åœ¨æ–°èŠ‚ç‚¹ä¸Šé…ç½®ç»„å¤åˆ¶
SET GLOBAL group_replication_group_name = 'aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee';
SET GLOBAL group_replication_local_address = '192.168.1.4:33061';
SET GLOBAL group_replication_group_seeds = '192.168.1.1:33061,192.168.1.2:33061,192.168.1.3:33061';
SET GLOBAL group_replication_bootstrap_group = OFF;

-- å¯åŠ¨ç»„å¤åˆ¶
START GROUP_REPLICATION;

-- æ£€æŸ¥åŠ å…¥çŠ¶æ€
SELECT * FROM performance_schema.replication_group_members;
```

### 4.2 èŠ‚ç‚¹æ•…éšœåŽçš„æ•°æ®æ¢å¤


**ðŸ”¸ æ•…éšœæ¢å¤æœºåˆ¶**
```
æ•…éšœæ£€æµ‹ï¼š
- å¿ƒè·³æ£€æµ‹ï¼šå®šæœŸå‘é€å¿ƒè·³åŒ…æ£€æµ‹èŠ‚ç‚¹çŠ¶æ€
- è¶…æ—¶åˆ¤æ–­ï¼šè¶…è¿‡é…ç½®æ—¶é—´æ— å“åº”åˆ™åˆ¤å®šä¸ºæ•…éšœ
- è‡ªåŠ¨å‰”é™¤ï¼šå°†æ•…éšœèŠ‚ç‚¹ä»Žé›†ç¾¤ä¸­ç§»é™¤

æ•°æ®æ¢å¤ï¼š
1. æ•…éšœèŠ‚ç‚¹é‡æ–°å¯åŠ¨
2. æ£€æµ‹ä¸Žé›†ç¾¤çš„æ•°æ®å·®å¼‚
3. ä»Žå…¶ä»–èŠ‚ç‚¹èŽ·å–å¢žé‡æ•°æ®
4. æ•°æ®åŒæ­¥å®ŒæˆåŽé‡æ–°åŠ å…¥é›†ç¾¤
```

**âš ï¸ æ•…éšœæ¢å¤æ³¨æ„äº‹é¡¹**
```sql
-- æ£€æŸ¥GTIDå·®å¼‚ï¼Œåˆ¤æ–­éœ€è¦æ¢å¤çš„æ•°æ®é‡
SHOW MASTER STATUS;
SHOW SLAVE STATUS;

-- å¦‚æžœå·®å¼‚å¤ªå¤§ï¼Œå¯èƒ½éœ€è¦é‡æ–°å…¨é‡åŒæ­¥
-- è®¾ç½®åˆç†çš„è¶…æ—¶å‚æ•°
SET GLOBAL group_replication_member_expel_timeout = 5;
```

---

## 5. ðŸ”¥ çƒ­ç‚¹æ•°æ®å¤„ç†


### 5.1 çƒ­ç‚¹æ•°æ®è¯†åˆ«


**ðŸ”¸ ä»€ä¹ˆæ˜¯çƒ­ç‚¹æ•°æ®**
```
çƒ­ç‚¹æ•°æ®ç‰¹å¾ï¼š
- è®¿é—®é¢‘çŽ‡é«˜ï¼šè¢«é¢‘ç¹æŸ¥è¯¢æˆ–ä¿®æ”¹çš„æ•°æ®
- è®¿é—®é›†ä¸­ï¼šåœ¨çŸ­æ—¶é—´å†…è¢«å¤§é‡è®¿é—®
- å½±å“æ€§èƒ½ï¼šå¯èƒ½å¯¼è‡´æŸäº›èŠ‚ç‚¹è´Ÿè½½è¿‡é«˜
```

**ðŸ“Š çƒ­ç‚¹æ•°æ®ç›‘æŽ§**
```sql
-- ç›‘æŽ§è¡¨çš„è®¿é—®é¢‘çŽ‡
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    TABLE_ROWS,
    DATA_LENGTH,
    INDEX_LENGTH,
    (DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024 AS size_mb
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC;

-- ç›‘æŽ§æ…¢æŸ¥è¯¢æ—¥å¿—
SELECT 
    query_time,
    lock_time,
    rows_sent,
    rows_examined,
    sql_text
FROM mysql.slow_log 
ORDER BY query_time DESC 
LIMIT 10;
```

### 5.2 çƒ­ç‚¹æ•°æ®å¤„ç†ç­–ç•¥


**ðŸ”¸ è¯»å†™åˆ†ç¦»ä¼˜åŒ–**
```
ç­–ç•¥åŽŸç†ï¼š
- å†™æ“ä½œï¼šä»ç„¶åªåœ¨PrimaryèŠ‚ç‚¹æ‰§è¡Œ
- è¯»æ“ä½œï¼šæ™ºèƒ½åˆ†å‘åˆ°è´Ÿè½½è¾ƒä½Žçš„SecondaryèŠ‚ç‚¹
- ç¼“å­˜ç­–ç•¥ï¼šåœ¨åº”ç”¨å±‚å¢žåŠ ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®
```

**ðŸ’» Routeré…ç½®ä¼˜åŒ–**
```ini
# é’ˆå¯¹çƒ­ç‚¹æ•°æ®çš„è¯»å†™åˆ†ç¦»é…ç½®
[routing:cluster_read_hot]
bind_address = 0.0.0.0
bind_port = 7002
destinations = mysql-secondary1:3306,mysql-secondary2:3306
mode = read-only
routing_strategy = least-connections
max_connections = 1000

[routing:cluster_write]
bind_address = 0.0.0.0
bind_port = 7000
destinations = mysql-primary:3306
mode = read-write
max_connections = 500
```

**ðŸŽ¯ åº”ç”¨å±‚ä¼˜åŒ–ç­–ç•¥**
```java
// Javaåº”ç”¨ä¸­çš„çƒ­ç‚¹æ•°æ®å¤„ç†ç¤ºä¾‹
@Service
public class HotDataService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Autowired
    private DataSource readDataSource;
    
    // çƒ­ç‚¹æ•°æ®æŸ¥è¯¢ï¼Œå…ˆæŸ¥ç¼“å­˜å†æŸ¥æ•°æ®åº“
    public User getUserById(Long userId) {
        // 1. å…ˆä»ŽRedisç¼“å­˜èŽ·å–
        String cacheKey = "user:" + userId;
        User user = (User) redisTemplate.opsForValue().get(cacheKey);
        
        if (user != null) {
            return user; // ç¼“å­˜å‘½ä¸­
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼Œä»Žåªè¯»èŠ‚ç‚¹æŸ¥è¯¢
        user = userRepository.findById(userId);
        
        // 3. å†™å…¥ç¼“å­˜ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
        if (user != null) {
            redisTemplate.opsForValue().set(cacheKey, user, 300, TimeUnit.SECONDS);
        }
        
        return user;
    }
}
```

---

## 6. ðŸ“ æ•°æ®å±€éƒ¨æ€§ä¼˜åŒ–


### 6.1 ç†è§£æ•°æ®å±€éƒ¨æ€§


**ðŸ”¸ å±€éƒ¨æ€§åŽŸç†**
```
æ—¶é—´å±€éƒ¨æ€§ï¼šæœ€è¿‘è®¿é—®è¿‡çš„æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è¢«è®¿é—®
ç©ºé—´å±€éƒ¨æ€§ï¼šç›¸é‚»çš„æ•°æ®å¾ˆå¯èƒ½è¢«ä¸€èµ·è®¿é—®
åº”ç”¨å±€éƒ¨æ€§ï¼šç›¸å…³ä¸šåŠ¡çš„æ•°æ®åº”è¯¥åœ¨ç‰©ç†ä¸Šå°½å¯èƒ½æŽ¥è¿‘
```

**ðŸ—ï¸ InnoDB Clusterä¸­çš„å±€éƒ¨æ€§è€ƒè™‘**
```
ç½‘ç»œå±€éƒ¨æ€§ï¼š
- å°†åº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“èŠ‚ç‚¹éƒ¨ç½²åœ¨åŒä¸€æœºæˆ¿
- å‡å°‘è·¨æœºæˆ¿çš„ç½‘ç»œå»¶è¿Ÿ

å­˜å‚¨å±€éƒ¨æ€§ï¼š
- ç›¸å…³æ•°æ®å­˜å‚¨åœ¨ç›¸åŒçš„é¡µé¢ä¸­
- åˆç†è®¾è®¡ç´¢å¼•æé«˜æŸ¥è¯¢æ•ˆçŽ‡
```

### 6.2 å±€éƒ¨æ€§ä¼˜åŒ–å®žè·µ


**ðŸ”¸ è¡¨ç»“æž„è®¾è®¡ä¼˜åŒ–**
```sql
-- ä¼˜åŒ–å‰ï¼šç”¨æˆ·ä¿¡æ¯åˆ†æ•£åœ¨å¤šä¸ªè¡¨ä¸­
CREATE TABLE users (
    id INT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100)
);

CREATE TABLE user_profiles (
    user_id INT,
    nickname VARCHAR(50),
    avatar_url VARCHAR(200),
    created_at TIMESTAMP
);

-- ä¼˜åŒ–åŽï¼šç›¸å…³ä¿¡æ¯åˆå¹¶åˆ°ä¸€ä¸ªè¡¨
CREATE TABLE users_optimized (
    id INT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100),
    nickname VARCHAR(50),
    avatar_url VARCHAR(200),
    created_at TIMESTAMP,
    -- æ·»åŠ é€‚å½“çš„ç´¢å¼•
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB;
```

**ðŸ“Š åˆ†åŒºç­–ç•¥ä¼˜åŒ–**
```sql
-- æŒ‰æ—¶é—´åˆ†åŒºï¼Œæé«˜æŸ¥è¯¢å±€éƒ¨æ€§
CREATE TABLE order_history (
    id INT AUTO_INCREMENT,
    user_id INT,
    order_amount DECIMAL(10,2),
    order_date DATE,
    status VARCHAR(20),
    PRIMARY KEY (id, order_date)
) ENGINE=InnoDB
PARTITION BY RANGE (YEAR(order_date)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

---

## 7. ðŸš€ åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–


### 7.1 æŸ¥è¯¢è·¯ç”±ç­–ç•¥


**ðŸ”¸ æ™ºèƒ½æŸ¥è¯¢åˆ†å‘**
```
æŸ¥è¯¢ç±»åž‹è¯†åˆ«ï¼š
- SELECTæŸ¥è¯¢ â†’ è·¯ç”±åˆ°SecondaryèŠ‚ç‚¹
- INSERT/UPDATE/DELETE â†’ è·¯ç”±åˆ°PrimaryèŠ‚ç‚¹
- äº‹åŠ¡æŸ¥è¯¢ â†’ ä¿æŒåœ¨åŒä¸€èŠ‚ç‚¹æ‰§è¡Œ

è´Ÿè½½æ„ŸçŸ¥è·¯ç”±ï¼š
- ç›‘æŽ§å„èŠ‚ç‚¹çš„CPUã€å†…å­˜ã€IOä½¿ç”¨çŽ‡
- ä¼˜å…ˆé€‰æ‹©è´Ÿè½½è¾ƒä½Žçš„èŠ‚ç‚¹å¤„ç†æŸ¥è¯¢
```

**ðŸ’» æŸ¥è¯¢ä¼˜åŒ–é…ç½®**
```sql
-- åœ¨åº”ç”¨ä¸­ä½¿ç”¨hintæŒ‡å®šèŠ‚ç‚¹
-- å¼ºåˆ¶ä½¿ç”¨ä¸»èŠ‚ç‚¹ï¼ˆä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼‰
SELECT /*+ USE_MASTER */ * FROM orders WHERE user_id = 12345;

-- ä¼˜å…ˆä½¿ç”¨ä»ŽèŠ‚ç‚¹ï¼ˆæé«˜è¯»æ€§èƒ½ï¼‰
SELECT /*+ USE_SLAVE */ * FROM products WHERE category = 'electronics';

-- è®¾ç½®æŸ¥è¯¢è¶…æ—¶
SET SESSION max_execution_time = 30000; -- 30ç§’è¶…æ—¶
```

### 7.2 æŸ¥è¯¢æ€§èƒ½ç›‘æŽ§


**ðŸ“Š æ€§èƒ½ç›‘æŽ§æŒ‡æ ‡**
```sql
-- ç›‘æŽ§å„èŠ‚ç‚¹çš„æŸ¥è¯¢æ€§èƒ½
SELECT 
    HOST,
    USER,
    DB,
    COMMAND,
    TIME,
    STATE,
    INFO
FROM information_schema.PROCESSLIST 
WHERE TIME > 5; -- æŸ¥çœ‹æ‰§è¡Œæ—¶é—´è¶…è¿‡5ç§’çš„æŸ¥è¯¢

-- ç›‘æŽ§ç»„å¤åˆ¶æ€§èƒ½
SELECT 
    MEMBER_HOST,
    COUNT_TRANSACTIONS_IN_QUEUE,
    COUNT_TRANSACTIONS_CHECKED,
    COUNT_CONFLICTS_DETECTED,
    COUNT_TRANSACTIONS_ROWS_VALIDATING
FROM performance_schema.replication_group_member_stats;
```

**ðŸŽ¯ æŸ¥è¯¢ä¼˜åŒ–æœ€ä½³å®žè·µ**
```sql
-- 1. ä½¿ç”¨åˆé€‚çš„ç´¢å¼•
EXPLAIN SELECT * FROM users WHERE email = 'user@example.com';

-- 2. é¿å…å…¨è¡¨æ‰«æ
SELECT * FROM orders WHERE order_date >= '2024-01-01' 
AND order_date < '2024-02-01';

-- 3. ä½¿ç”¨LIMITé™åˆ¶ç»“æžœé›†
SELECT * FROM products ORDER BY created_at DESC LIMIT 10;

-- 4. ä¼˜åŒ–JOINæŸ¥è¯¢
SELECT u.username, o.order_amount 
FROM users u 
INNER JOIN orders o ON u.id = o.user_id 
WHERE u.status = 'active';
```

---

## 8. ðŸ“ˆ æ•°æ®è®¿é—®æ¨¡å¼åˆ†æž


### 8.1 è®¿é—®æ¨¡å¼è¯†åˆ«


**ðŸ”¸ å¸¸è§è®¿é—®æ¨¡å¼**
```
è¯»å¯†é›†åž‹ï¼š
- ç‰¹ç‚¹ï¼šæŸ¥è¯¢æ“ä½œè¿œå¤šäºŽå†™å…¥æ“ä½œ
- åœºæ™¯ï¼šç”µå•†å•†å“å±•ç¤ºã€æ–°é—»ç½‘ç«™ã€æŠ¥è¡¨ç³»ç»Ÿ
- ä¼˜åŒ–ï¼šå¢žåŠ æ›´å¤šSecondaryèŠ‚ç‚¹ï¼Œä½¿ç”¨ç¼“å­˜

å†™å¯†é›†åž‹ï¼š
- ç‰¹ç‚¹ï¼šå¤§é‡çš„INSERTã€UPDATEã€DELETEæ“ä½œ
- åœºæ™¯ï¼šæ—¥å¿—æ”¶é›†ã€å®žæ—¶æ•°æ®å¤„ç†ã€äº¤æ˜“ç³»ç»Ÿ
- ä¼˜åŒ–ï¼šä¼˜åŒ–PrimaryèŠ‚ç‚¹æ€§èƒ½ï¼Œè€ƒè™‘åˆ†åº“åˆ†è¡¨

æ··åˆåž‹ï¼š
- ç‰¹ç‚¹ï¼šè¯»å†™æ“ä½œéƒ½æ¯”è¾ƒé¢‘ç¹
- åœºæ™¯ï¼šç¤¾äº¤åª’ä½“ã€åä½œå¹³å°ã€CRMç³»ç»Ÿ
- ä¼˜åŒ–ï¼šè¯»å†™åˆ†ç¦»ï¼Œæ™ºèƒ½è·¯ç”±
```

**ðŸ“Š è®¿é—®æ¨¡å¼ç›‘æŽ§**
```sql
-- ç»Ÿè®¡è¯»å†™æ¯”ä¾‹
SELECT 
    VARIABLE_NAME,
    VARIABLE_VALUE
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME IN (
    'Com_select',
    'Com_insert', 
    'Com_update',
    'Com_delete'
);

-- è®¡ç®—è¯»å†™æ¯”ä¾‹
SELECT 
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME = 'Com_select') as reads,
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME = 'Com_insert') +
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME = 'Com_update') +
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME = 'Com_delete') as writes;
```

### 8.2 è®¿é—®æ¨¡å¼ä¼˜åŒ–ç­–ç•¥


**ðŸ”¸ é’ˆå¯¹ä¸åŒæ¨¡å¼çš„ä¼˜åŒ–**
```
è¯»å¯†é›†åž‹ä¼˜åŒ–ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å±‚          â”‚ â† Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MySQL Router    â”‚ â† æ™ºèƒ½è·¯ç”±åˆ°è¯»èŠ‚ç‚¹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Primary (1å°)   â”‚ â† å¤„ç†å†™æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Secondary (3å°) â”‚ â† åˆ†æ‹…è¯»æ“ä½œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å†™å¯†é›†åž‹ä¼˜åŒ–ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å±‚          â”‚ â† æ‰¹é‡å†™å…¥ï¼Œäº‹åŠ¡ä¼˜åŒ–
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MySQL Router    â”‚ â† å¿«é€Ÿè·¯ç”±
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Primary (é«˜é…)  â”‚ â† å¼ºåŒ–å†™æ€§èƒ½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Secondary (2å°) â”‚ â† åŸºæœ¬è¯»æ”¯æŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. ðŸ’¾ å­˜å‚¨åˆ©ç”¨çŽ‡ä¼˜åŒ–


### 9.1 å­˜å‚¨ç©ºé—´ç›‘æŽ§


**ðŸ”¸ å­˜å‚¨ä½¿ç”¨æƒ…å†µåˆ†æž**
```sql
-- æŸ¥çœ‹å„æ•°æ®åº“çš„å­˜å‚¨ä½¿ç”¨æƒ…å†µ
SELECT 
    TABLE_SCHEMA as database_name,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) as size_mb,
    ROUND(SUM(DATA_FREE) / 1024 / 1024, 2) as free_mb
FROM information_schema.TABLES 
GROUP BY TABLE_SCHEMA
ORDER BY size_mb DESC;

-- æŸ¥çœ‹æœ€å¤§çš„è¡¨
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    TABLE_ROWS,
    ROUND((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) as size_mb,
    ROUND(DATA_FREE / 1024 / 1024, 2) as free_mb
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC 
LIMIT 10;
```

### 9.2 å­˜å‚¨ä¼˜åŒ–ç­–ç•¥


**ðŸ”¸ æ•°æ®åŽ‹ç¼©ä¼˜åŒ–**
```sql
-- å¯ç”¨è¡¨åŽ‹ç¼©
CREATE TABLE compressed_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    log_time TIMESTAMP,
    log_level VARCHAR(10),
    message TEXT,
    INDEX idx_log_time (log_time)
) ENGINE=InnoDB ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;

-- å¯¹çŽ°æœ‰è¡¨å¯ç”¨åŽ‹ç¼©
ALTER TABLE existing_table ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;
```

**ðŸ”¸ æ•°æ®å½’æ¡£ç­–ç•¥**
```sql
-- åˆ›å»ºå½’æ¡£è¡¨
CREATE TABLE orders_archive LIKE orders;

-- å½’æ¡£åŽ†å²æ•°æ®
INSERT INTO orders_archive 
SELECT * FROM orders 
WHERE order_date < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- åˆ é™¤åŽŸè¡¨ä¸­çš„åŽ†å²æ•°æ®
DELETE FROM orders 
WHERE order_date < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- ä¼˜åŒ–è¡¨ç©ºé—´
OPTIMIZE TABLE orders;
```

**ðŸ“Š å­˜å‚¨ä¼˜åŒ–æ•ˆæžœç›‘æŽ§**
```sql
-- ç›‘æŽ§åŽ‹ç¼©æ•ˆæžœ
SELECT 
    TABLE_NAME,
    ROW_FORMAT,
    TABLE_ROWS,
    AVG_ROW_LENGTH,
    ROUND((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) as size_mb
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database'
AND ROW_FORMAT = 'Compressed';
```

---

## 10. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ðŸ”¸ æ•°æ®åˆ†å¸ƒæœ¬è´¨ï¼šInnoDB Clusteré‡‡ç”¨å…¨é‡å¤åˆ¶ï¼Œä¸æ˜¯æ•°æ®åˆ†ç‰‡
ðŸ”¸ ä¸€è‡´æ€§ä¿è¯ï¼šé€šè¿‡Group Replicationç¡®ä¿å¼ºä¸€è‡´æ€§
ðŸ”¸ è´Ÿè½½å‡è¡¡ï¼šMySQL Routeræ™ºèƒ½åˆ†å‘è¯»å†™è¯·æ±‚
ðŸ”¸ æ•…éšœæ¢å¤ï¼šè‡ªåŠ¨æ£€æµ‹æ•…éšœå¹¶è¿›è¡Œæ•°æ®åŒæ­¥æ¢å¤
ðŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šé€šè¿‡åˆç†çš„è®¿é—®æ¨¡å¼åˆ†æžå’Œå­˜å‚¨ä¼˜åŒ–æå‡æ€§èƒ½
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ æ•°æ®åˆ†å¸ƒç­–ç•¥çš„æ ¸å¿ƒæ€æƒ³**
```
é«˜å¯ç”¨æ€§ï¼šé€šè¿‡å¤šèŠ‚ç‚¹ä¿è¯æœåŠ¡ä¸ä¸­æ–­
ä¸€è‡´æ€§ï¼šç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹æ•°æ®å®Œå…¨ä¸€è‡´  
æ€§èƒ½ä¼˜åŒ–ï¼šé€šè¿‡è¯»å†™åˆ†ç¦»å’Œè´Ÿè½½å‡è¡¡æå‡æ€§èƒ½
èµ„æºåˆ©ç”¨ï¼šåˆç†åˆ†é…å­˜å‚¨å’Œè®¡ç®—èµ„æº
```

**ðŸ”¹ å®žé™…åº”ç”¨åœºæ™¯é€‰æ‹©**
```
å°åž‹åº”ç”¨ï¼š3èŠ‚ç‚¹é›†ç¾¤ï¼ŒåŸºæœ¬çš„è¯»å†™åˆ†ç¦»
ä¸­åž‹åº”ç”¨ï¼š5-7èŠ‚ç‚¹é›†ç¾¤ï¼Œå¢žåŠ ç¼“å­˜å±‚ï¼Œä¼˜åŒ–çƒ­ç‚¹æ•°æ®å¤„ç†
å¤§åž‹åº”ç”¨ï¼š7+èŠ‚ç‚¹é›†ç¾¤ï¼Œå®Œæ•´çš„ç›‘æŽ§ä½“ç³»ï¼Œè‡ªåŠ¨åŒ–è¿ç»´
```

### 10.3 æœ€ä½³å®žè·µå»ºè®®


**ðŸŽ¯ é…ç½®å»ºè®®**
```
èŠ‚ç‚¹é…ç½®ï¼š
- å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼ˆ3ã€5ã€7ï¼‰ï¼Œä¾¿äºŽé€‰ä¸¾
- èŠ‚ç‚¹é—´ç½‘ç»œå»¶è¿Ÿä½ŽäºŽ2ms
- å……è¶³çš„å†…å­˜å’ŒSSDå­˜å‚¨

ç›‘æŽ§é‡ç‚¹ï¼š
- å¤åˆ¶å»¶è¿Ÿå’Œå†²çªæ£€æµ‹
- å„èŠ‚ç‚¹çš„è´Ÿè½½å‡è¡¡æƒ…å†µ  
- å­˜å‚¨ä½¿ç”¨çŽ‡å’Œå¢žé•¿è¶‹åŠ¿
- æŸ¥è¯¢æ€§èƒ½å’Œæ…¢æŸ¥è¯¢åˆ†æž
```

**âš ï¸ å¸¸è§é™·é˜±ä¸Žè§£å†³æ–¹æ¡ˆ**
```
ç½‘ç»œåˆ†åŒºï¼š
é—®é¢˜ï¼šèŠ‚ç‚¹é—´ç½‘ç»œä¸ç¨³å®šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´
è§£å†³ï¼šé…ç½®åˆç†çš„è¶…æ—¶å‚æ•°ï¼Œä½¿ç”¨ä¸“ç”¨ç½‘ç»œ

å†™å…¥ç“¶é¢ˆï¼š
é—®é¢˜ï¼šæ‰€æœ‰å†™å…¥é›†ä¸­åœ¨PrimaryèŠ‚ç‚¹
è§£å†³ï¼šä¼˜åŒ–å†™å…¥é€»è¾‘ï¼Œè€ƒè™‘ä¸šåŠ¡å±‚é¢çš„åˆ†åº“åˆ†è¡¨

ç¼“å­˜å¤±æ•ˆï¼š
é—®é¢˜ï¼šçƒ­ç‚¹æ•°æ®ç¼“å­˜å¤±æ•ˆå¯¼è‡´æ•°æ®åº“åŽ‹åŠ›æ¿€å¢ž
è§£å†³ï¼šè®¾ç½®åˆç†çš„ç¼“å­˜ç­–ç•¥å’Œé™çº§æœºåˆ¶
```

### 10.4 æ€§èƒ½è°ƒä¼˜æ–¹å‘


**ðŸ“ˆ ä¼˜åŒ–é‡ç‚¹**
- **åº”ç”¨å±‚ä¼˜åŒ–**ï¼šåˆç†ä½¿ç”¨ç¼“å­˜ï¼Œä¼˜åŒ–SQLæŸ¥è¯¢
- **ç½‘ç»œå±‚ä¼˜åŒ–**ï¼šå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œä½¿ç”¨è¿žæŽ¥æ± 
- **å­˜å‚¨å±‚ä¼˜åŒ–**ï¼šåˆç†è®¾è®¡è¡¨ç»“æž„ï¼Œä½¿ç”¨åŽ‹ç¼©å’Œå½’æ¡£
- **è¿ç»´å±‚ä¼˜åŒ–**ï¼šè‡ªåŠ¨åŒ–ç›‘æŽ§ï¼Œæ™ºèƒ½å‘Šè­¦ï¼Œå®¹é‡è§„åˆ’

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åˆ†å¸ƒä¸ºå¯ç”¨ï¼Œä¸€è‡´æ˜¯åŸºç¡€
- è¯»å†™è¦åˆ†ç¦»ï¼Œè´Ÿè½½éœ€å‡è¡¡  
- ç›‘æŽ§ä¸å¯å°‘ï¼Œä¼˜åŒ–æ— æ­¢å¢ƒ
- å®žè·µå‡ºçœŸçŸ¥ï¼Œç»éªŒæœ€å®è´µ