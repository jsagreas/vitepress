---
title: 14ã€MySQL Shellé«˜çº§æ“ä½œ
---
## ğŸ“š ç›®å½•

1. [MySQL ShellåŸºç¡€æ¦‚å¿µ](#1-mysql-shellåŸºç¡€æ¦‚å¿µ)
2. [Shellè„šæœ¬å¼€å‘](#2-shellè„šæœ¬å¼€å‘)
3. [æ‰¹é‡æ“ä½œAPI](#3-æ‰¹é‡æ“ä½œapi)
4. [è‡ªå®šä¹‰å‡½æ•°å¼€å‘](#4-è‡ªå®šä¹‰å‡½æ•°å¼€å‘)
5. [Shellæ’ä»¶æœºåˆ¶](#5-shellæ’ä»¶æœºåˆ¶)
6. [æ“ä½œå®¡è®¡æ—¥å¿—](#6-æ“ä½œå®¡è®¡æ—¥å¿—)
7. [Shellæ€§èƒ½ä¼˜åŒ–](#7-shellæ€§èƒ½ä¼˜åŒ–)
8. [Shellå®‰å…¨é…ç½®](#8-shellå®‰å…¨é…ç½®)
9. [è¿œç¨‹æ“ä½œç®¡ç†](#9-è¿œç¨‹æ“ä½œç®¡ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ MySQL ShellåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯MySQL Shell

**é€šä¿—ç†è§£**ï¼šMySQL Shellæ˜¯MySQLå®˜æ–¹æä¾›çš„ä¸€ä¸ªå¢å¼ºç‰ˆå‘½ä»¤è¡Œå·¥å…·ï¼Œå°±åƒä¼ ç»Ÿçš„mysqlå®¢æˆ·ç«¯çš„"è¶…çº§ç‰ˆæœ¬"ã€‚

```
ä¼ ç»Ÿmysqlå®¢æˆ·ç«¯ï¼š           MySQL Shellï¼š
     mysql                    mysqlsh
       |                        |
   åªèƒ½æ‰§è¡ŒSQL              æ”¯æŒSQL + JavaScript + Python
       |                        |
   åŠŸèƒ½ç›¸å¯¹ç®€å•             åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒé›†ç¾¤ç®¡ç†
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šå¯ä»¥ä½¿ç”¨SQLã€JavaScriptã€Pythonä¸‰ç§è¯­è¨€
- **é›†ç¾¤ç®¡ç†**ï¼šä¸“é—¨ä¸ºInnoDB Clusterè®¾è®¡çš„ç®¡ç†å·¥å…·
- **APIä¸°å¯Œ**ï¼šæä¾›å¤§é‡ç°æˆçš„ç®¡ç†API
- **è‡ªåŠ¨åŒ–å‹å¥½**ï¼šæ”¯æŒè„šæœ¬åŒ–æ“ä½œï¼Œä¾¿äºè‡ªåŠ¨åŒ–éƒ¨ç½²

### 1.2 Shellçš„ä¸‰ç§å·¥ä½œæ¨¡å¼


**æ¨¡å¼åˆ‡æ¢ç¤ºæ„å›¾**ï¼š
```
MySQL Shellå¯åŠ¨
       |
   \js --mode=js     JavaScriptæ¨¡å¼ (é»˜è®¤)
   \py --mode=py     Pythonæ¨¡å¼  
   \sql              SQLæ¨¡å¼
       |
   éšæ—¶å¯ä»¥ç”¨ \js \py \sql åˆ‡æ¢æ¨¡å¼
```

**å„æ¨¡å¼ç‰¹ç‚¹**ï¼š
```markdown
ğŸ”¸ **SQLæ¨¡å¼**
- åŠŸèƒ½ï¼šæ‰§è¡Œæ ‡å‡†SQLè¯­å¥ï¼Œç±»ä¼¼ä¼ ç»Ÿmysqlå®¢æˆ·ç«¯
- é€‚ç”¨ï¼šæ—¥å¸¸æŸ¥è¯¢ã€æ•°æ®æ“ä½œ
- ç¤ºä¾‹ï¼šSELECT * FROM users;

ğŸ”¸ **JavaScriptæ¨¡å¼**
- åŠŸèƒ½ï¼šä½¿ç”¨JSè¯­æ³•æ“ä½œMySQLï¼Œè°ƒç”¨Shell API
- é€‚ç”¨ï¼šé›†ç¾¤ç®¡ç†ã€è‡ªåŠ¨åŒ–è„šæœ¬
- ç¤ºä¾‹ï¼šcluster.status()

ğŸ”¸ **Pythonæ¨¡å¼**  
- åŠŸèƒ½ï¼šä½¿ç”¨Pythonè¯­æ³•æ“ä½œMySQL
- é€‚ç”¨ï¼šæ•°æ®åˆ†æã€å¤æ‚è„šæœ¬å¼€å‘
- ç¤ºä¾‹ï¼šsession.run_sql("SHOW DATABASES")
```

### 1.3 Shellä¸ä¼ ç»Ÿå®¢æˆ·ç«¯å¯¹æ¯”


| åŠŸèƒ½ç‰¹æ€§ | **ä¼ ç»Ÿmysqlå®¢æˆ·ç«¯** | **MySQL Shell** |
|---------|------------------|----------------|
| **è¯­è¨€æ”¯æŒ** | `ä»…SQL` | `SQL + JavaScript + Python` |
| **é›†ç¾¤ç®¡ç†** | `ä¸æ”¯æŒ` | `ä¸“ä¸šé›†ç¾¤ç®¡ç†` |
| **è„šæœ¬åŒ–** | `æœ‰é™` | `å¼ºå¤§çš„è„šæœ¬èƒ½åŠ›` |
| **APIæ”¯æŒ** | `æ— ` | `ä¸°å¯Œçš„ç®¡ç†API` |
| **å­¦ä¹ æˆæœ¬** | `ä½` | `ä¸­ç­‰ï¼ˆéœ€è¦å­¦ä¹ APIï¼‰` |
| **é€‚ç”¨åœºæ™¯** | `ç®€å•æŸ¥è¯¢æ“ä½œ` | `å¤æ‚ç®¡ç†ã€è‡ªåŠ¨åŒ–` |

---

## 2. ğŸ“ Shellè„šæœ¬å¼€å‘


### 2.1 è„šæœ¬å¼€å‘åŸºç¡€


**ä»€ä¹ˆæ˜¯Shellè„šæœ¬**ï¼šå°±æ˜¯æŠŠè¦åœ¨MySQL Shellä¸­æ‰§è¡Œçš„å‘½ä»¤å†™æˆæ–‡ä»¶ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨çš„è‡ªåŠ¨åŒ–è„šæœ¬ã€‚

**è„šæœ¬æ–‡ä»¶ç±»å‹**ï¼š
```
JavaScriptè„šæœ¬ï¼š  .jsæ–‡ä»¶
Pythonè„šæœ¬ï¼š     .pyæ–‡ä»¶  
SQLè„šæœ¬ï¼š        .sqlæ–‡ä»¶
```

### 2.2 JavaScriptè„šæœ¬å¼€å‘


**åŸºç¡€è„šæœ¬ç»“æ„**ï¼š
```javascript
// è¿æ¥åˆ°MySQLå®ä¾‹
var session = mysql.getSession('admin@localhost:3306');

// æ‰§è¡ŒSQLæŸ¥è¯¢
var result = session.runSql('SHOW DATABASES');

// å¤„ç†ç»“æœ
var databases = result.fetchAll();
for (var i = 0; i < databases.length; i++) {
    print("æ•°æ®åº“: " + databases[i][0]);
}

// å…³é—­è¿æ¥
session.close();
```

**å®ç”¨è„šæœ¬ç¤ºä¾‹ï¼šæ•°æ®åº“å¤‡ä»½æ£€æŸ¥**
```javascript
// backup_check.js - æ£€æŸ¥æ‰€æœ‰æ•°æ®åº“çš„å¤‡ä»½çŠ¶æ€
function checkBackupStatus() {
    var session = mysql.getSession('admin@localhost:3306');
    
    // è·å–æ‰€æœ‰æ•°æ®åº“
    var result = session.runSql('SHOW DATABASES');
    var databases = result.fetchAll();
    
    print("=== æ•°æ®åº“å¤‡ä»½çŠ¶æ€æ£€æŸ¥ ===");
    
    for (var db of databases) {
        var dbName = db[0];
        
        // è·³è¿‡ç³»ç»Ÿæ•°æ®åº“
        if (['information_schema', 'performance_schema', 'mysql', 'sys'].includes(dbName)) {
            continue;
        }
        
        // æ£€æŸ¥å¤‡ä»½è¡¨æ˜¯å¦å­˜åœ¨
        var backupCheck = session.runSql(
            'SELECT COUNT(*) FROM information_schema.tables ' +
            'WHERE table_schema = ? AND table_name LIKE "%_backup"', 
            [dbName]
        );
        
        var backupCount = backupCheck.fetchOne()[0];
        
        if (backupCount > 0) {
            print("âœ… " + dbName + ": å­˜åœ¨" + backupCount + "ä¸ªå¤‡ä»½è¡¨");
        } else {
            print("âŒ " + dbName + ": æ— å¤‡ä»½è¡¨");
        }
    }
    
    session.close();
}

// æ‰§è¡Œæ£€æŸ¥
checkBackupStatus();
```

### 2.3 Pythonè„šæœ¬å¼€å‘


**åŸºç¡€Pythonè„šæœ¬**ï¼š
```python
# connect_and_query.py
import mysqlsh

# å»ºç«‹è¿æ¥
session = mysqlsh.mysql.get_session('admin@localhost:3306')

try:
    # æ‰§è¡ŒæŸ¥è¯¢
    result = session.run_sql('SELECT VERSION()')
    version = result.fetch_one()
    print(f"MySQLç‰ˆæœ¬: {version[0]}")
    
    # è·å–æ•°æ®åº“åˆ—è¡¨
    result = session.run_sql('SHOW DATABASES')
    databases = result.fetch_all()
    
    print("æ•°æ®åº“åˆ—è¡¨:")
    for db in databases:
        print(f"  - {db[0]}")
        
finally:
    session.close()
```

### 2.4 è„šæœ¬æ‰§è¡Œæ–¹å¼


**å‘½ä»¤è¡Œæ‰§è¡Œ**ï¼š
```bash
# æ‰§è¡ŒJavaScriptè„šæœ¬
mysqlsh --file=backup_check.js

# æ‰§è¡ŒPythonè„šæœ¬  
mysqlsh --pym --file=connect_and_query.py

# æ‰§è¡ŒSQLè„šæœ¬
mysqlsh --sql --file=database_setup.sql
```

**äº¤äº’å¼æ‰§è¡Œ**ï¼š
```javascript
// åœ¨MySQL Shellä¸­
\source backup_check.js

// æˆ–è€…
\. backup_check.js
```

---

## 3. ğŸ”„ æ‰¹é‡æ“ä½œAPI


### 3.1 æ‰¹é‡æ“ä½œçš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦æ‰¹é‡æ“ä½œ**ï¼š
- **æ•ˆç‡æå‡**ï¼šä¸€æ¬¡æ“ä½œå¤šä¸ªå¯¹è±¡ï¼Œé¿å…é‡å¤è¿æ¥
- **äº‹åŠ¡ä¸€è‡´æ€§**ï¼šä¿è¯å¤šä¸ªæ“ä½œçš„åŸå­æ€§
- **å‡å°‘ç½‘ç»œå¼€é”€**ï¼šå‡å°‘å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„äº¤äº’æ¬¡æ•°

### 3.2 æ‰¹é‡æ•°æ®å¯¼å…¥


**ä½¿ç”¨util.importTable()è¿›è¡Œæ‰¹é‡å¯¼å…¥**ï¼š
```javascript
// æ‰¹é‡å¯¼å…¥CSVæ–‡ä»¶
util.importTable("users.csv", {
    schema: "myapp",           // ç›®æ ‡æ•°æ®åº“
    table: "users",            // ç›®æ ‡è¡¨
    fieldsTerminatedBy: ",",   // å­—æ®µåˆ†éš”ç¬¦
    fieldsEnclosedBy: '"',     // å­—æ®µåŒ…å›´ç¬¦
    linesTerminatedBy: "\n",   // è¡Œåˆ†éš”ç¬¦
    skipRows: 1,               // è·³è¿‡è¡¨å¤´
    showProgress: true,        // æ˜¾ç¤ºè¿›åº¦
    threads: 4                 // å¹¶è¡Œçº¿ç¨‹æ•°
});
```

**æ‰¹é‡å¯¼å…¥é€‰é¡¹è¯¦è§£**ï¼š
```markdown
ğŸ“Š **é‡è¦å‚æ•°è¯´æ˜**

ğŸ”¸ **schema**: ç›®æ ‡æ•°æ®åº“åç§°
ğŸ”¸ **table**: ç›®æ ‡è¡¨åç§°  
ğŸ”¸ **columns**: æŒ‡å®šåˆ—çš„æ˜ å°„å…³ç³»
ğŸ”¸ **fieldsTerminatedBy**: å­—æ®µåˆ†éš”ç¬¦ï¼ˆCSVç”¨é€—å·ï¼‰
ğŸ”¸ **threads**: å¹¶è¡Œçº¿ç¨‹æ•°ï¼ˆæé«˜å¯¼å…¥é€Ÿåº¦ï¼‰
ğŸ”¸ **skipRows**: è·³è¿‡çš„è¡Œæ•°ï¼ˆé€šå¸¸è·³è¿‡CSVè¡¨å¤´ï¼‰
ğŸ”¸ **maxRate**: é™åˆ¶å¯¼å…¥é€Ÿåº¦ï¼ˆé¿å…å½±å“ç”Ÿäº§ï¼‰
```

### 3.3 æ‰¹é‡æ•°æ®å¯¼å‡º


**ä½¿ç”¨util.exportTable()è¿›è¡Œæ‰¹é‡å¯¼å‡º**ï¼š
```javascript
// å¯¼å‡ºè¡¨æ•°æ®åˆ°CSV
util.exportTable("myapp.users", "users_export.csv", {
    fieldsTerminatedBy: ",",
    fieldsEnclosedBy: '"',
    linesTerminatedBy: "\n",
    includeColumnNames: true,  // åŒ…å«åˆ—åä½œä¸ºè¡¨å¤´
    where: "created_date >= '2024-01-01'"  // æ¡ä»¶è¿‡æ»¤
});
```

### 3.4 æ‰¹é‡è¡¨æ“ä½œ


**æ‰¹é‡åˆ›å»ºè¡¨çš„è„šæœ¬ç¤ºä¾‹**ï¼š
```javascript
// æ‰¹é‡åˆ›å»ºåˆ†è¡¨
function createMonthlyTables(year) {
    var session = mysql.getSession('admin@localhost:3306');
    session.runSql('USE myapp');
    
    // åˆ›å»º12ä¸ªæœˆçš„åˆ†è¡¨
    for (var month = 1; month <= 12; month++) {
        var monthStr = month.toString().padStart(2, '0');
        var tableName = `orders_${year}_${monthStr}`;
        
        var createSql = `
            CREATE TABLE IF NOT EXISTS ${tableName} (
                id INT AUTO_INCREMENT PRIMARY KEY,
                order_date DATE NOT NULL,
                customer_id INT NOT NULL,
                amount DECIMAL(10,2) NOT NULL,
                status VARCHAR(20) DEFAULT 'pending',
                INDEX idx_date (order_date),
                INDEX idx_customer (customer_id)
            ) ENGINE=InnoDB
        `;
        
        try {
            session.runSql(createSql);
            print(`âœ… åˆ›å»ºè¡¨æˆåŠŸ: ${tableName}`);
        } catch (error) {
            print(`âŒ åˆ›å»ºè¡¨å¤±è´¥: ${tableName} - ${error.message}`);
        }
    }
    
    session.close();
}

// æ‰§è¡Œï¼šåˆ›å»º2024å¹´çš„æœˆåˆ†è¡¨
createMonthlyTables(2024);
```

---

## 4. ğŸ› ï¸ è‡ªå®šä¹‰å‡½æ•°å¼€å‘


### 4.1 è‡ªå®šä¹‰å‡½æ•°çš„ä½œç”¨


**ä¸ºä»€ä¹ˆè¦å¼€å‘è‡ªå®šä¹‰å‡½æ•°**ï¼š
- **ä»£ç å¤ç”¨**ï¼šå¸¸ç”¨æ“ä½œå°è£…æˆå‡½æ•°ï¼Œé¿å…é‡å¤ç¼–å†™
- **ç®€åŒ–æ“ä½œ**ï¼šå¤æ‚çš„ç®¡ç†ä»»åŠ¡ç”¨ç®€å•å‡½æ•°è°ƒç”¨
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€å›¢é˜Ÿçš„æ“ä½œè§„èŒƒ

### 4.2 JavaScriptè‡ªå®šä¹‰å‡½æ•°


**å‡½æ•°å¼€å‘åŸºç¡€æ¨¡æ¿**ï¼š
```javascript
// è‡ªå®šä¹‰å‡½æ•°ï¼šè·å–æ•°æ®åº“å¤§å°
function getDatabaseSize(schemaName) {
    var session = mysql.getSession();
    
    try {
        var query = `
            SELECT 
                table_schema AS 'æ•°æ®åº“',
                ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'å¤§å°(MB)'
            FROM information_schema.tables 
            WHERE table_schema = ?
            GROUP BY table_schema
        `;
        
        var result = session.runSql(query, [schemaName]);
        var row = result.fetchOne();
        
        if (row) {
            return {
                database: row[0],
                size_mb: row[1],
                success: true
            };
        } else {
            return {
                success: false,
                error: "æ•°æ®åº“ä¸å­˜åœ¨"
            };
        }
    } catch (error) {
        return {
            success: false,
            error: error.message
        };
    }
}

// ä½¿ç”¨ç¤ºä¾‹
var size = getDatabaseSize('myapp');
if (size.success) {
    print(`æ•°æ®åº“ ${size.database} å¤§å°: ${size.size_mb} MB`);
} else {
    print(`é”™è¯¯: ${size.error}`);
}
```

**å®ç”¨å‡½æ•°ï¼šè¡¨ç»´æŠ¤æ“ä½œ**ï¼š
```javascript
// è‡ªå®šä¹‰å‡½æ•°ï¼šè¡¨ç»´æŠ¤ï¼ˆä¼˜åŒ–ã€åˆ†æã€æ£€æŸ¥ï¼‰
function maintainTable(schemaName, tableName, operations = ['OPTIMIZE', 'ANALYZE']) {
    var session = mysql.getSession();
    var results = [];
    
    for (var op of operations) {
        var sql = `${op} TABLE ${schemaName}.${tableName}`;
        
        try {
            var startTime = new Date();
            session.runSql(sql);
            var endTime = new Date();
            var duration = endTime - startTime;
            
            results.push({
                operation: op,
                table: `${schemaName}.${tableName}`,
                success: true,
                duration_ms: duration
            });
            
            print(`âœ… ${op} ${schemaName}.${tableName} å®Œæˆ (${duration}ms)`);
            
        } catch (error) {
            results.push({
                operation: op,
                table: `${schemaName}.${tableName}`,
                success: false,
                error: error.message
            });
            
            print(`âŒ ${op} ${schemaName}.${tableName} å¤±è´¥: ${error.message}`);
        }
    }
    
    return results;
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šç»´æŠ¤ç”¨æˆ·è¡¨
var maintenanceResults = maintainTable('myapp', 'users', ['ANALYZE', 'OPTIMIZE']);
```

### 4.3 å‡½æ•°åº“ç®¡ç†


**åˆ›å»ºå‡½æ•°åº“æ–‡ä»¶**ï¼š
```javascript
// mysql_utils.js - MySQLå·¥å…·å‡½æ•°åº“

// å¯¼å‡ºå‡½æ•°åº“å¯¹è±¡
var MySQLUtils = {
    
    // è·å–è¿æ¥ä¿¡æ¯
    getConnectionInfo: function() {
        var session = mysql.getSession();
        var result = session.runSql('SELECT CONNECTION_ID(), USER(), DATABASE()');
        var row = result.fetchOne();
        
        return {
            connection_id: row[0],
            user: row[1],
            database: row[2]
        };
    },
    
    // æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
    tableExists: function(schema, table) {
        var session = mysql.getSession();
        var result = session.runSql(
            'SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = ? AND table_name = ?',
            [schema, table]
        );
        return result.fetchOne()[0] > 0;
    },
    
    // è·å–è¡¨çš„è¡Œæ•°
    getTableRowCount: function(schema, table) {
        if (!this.tableExists(schema, table)) {
            throw new Error(`è¡¨ ${schema}.${table} ä¸å­˜åœ¨`);
        }
        
        var session = mysql.getSession();
        var result = session.runSql(`SELECT COUNT(*) FROM ${schema}.${table}`);
        return result.fetchOne()[0];
    }
};

// ä½¿ç”¨å‡½æ•°åº“
// \source mysql_utils.js
// var info = MySQLUtils.getConnectionInfo();
// print("å½“å‰è¿æ¥ID: " + info.connection_id);
```

---

## 5. ğŸ”Œ Shellæ’ä»¶æœºåˆ¶


### 5.1 æ’ä»¶ç³»ç»Ÿæ¦‚è¿°


**ä»€ä¹ˆæ˜¯Shellæ’ä»¶**ï¼šæ’ä»¶æ˜¯æ‰©å±•MySQL ShellåŠŸèƒ½çš„æ¨¡å—ï¼Œå°±åƒç»™æµè§ˆå™¨å®‰è£…æ‰©å±•ä¸€æ ·ï¼Œå¯ä»¥æ·»åŠ æ–°çš„å‘½ä»¤å’ŒåŠŸèƒ½ã€‚

**æ’ä»¶çš„å¥½å¤„**ï¼š
- **åŠŸèƒ½æ‰©å±•**ï¼šæ·»åŠ ShellåŸæœ¬æ²¡æœ‰çš„åŠŸèƒ½
- **ä»£ç å¤ç”¨**ï¼šä¸€æ¬¡å¼€å‘ï¼Œå¤šå¤„ä½¿ç”¨
- **å›¢é˜Ÿåä½œ**ï¼šå…±äº«å¸¸ç”¨çš„ç®¡ç†å·¥å…·

### 5.2 æ’ä»¶ç›®å½•ç»“æ„


**æ ‡å‡†æ’ä»¶ç›®å½•**ï¼š
```
~/.mysqlsh/plugins/
â”œâ”€â”€ my_plugin/
â”‚   â”œâ”€â”€ init.js          # æ’ä»¶å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ lib/             # åº“æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ utils.js     # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ database.js  # æ•°æ®åº“æ“ä½œ
â”‚   â””â”€â”€ README.md        # æ’ä»¶è¯´æ˜
```

### 5.3 å¼€å‘ç®€å•æ’ä»¶


**æ’ä»¶å…¥å£æ–‡ä»¶ç¤ºä¾‹** (`init.js`)ï¼š
```javascript
// æ’ä»¶æ³¨å†Œ
var my_plugin = {
    // æ’ä»¶ä¿¡æ¯
    name: "my_plugin",
    version: "1.0.0",
    description: "æˆ‘çš„è‡ªå®šä¹‰MySQLç®¡ç†æ’ä»¶",
    
    // æ’ä»¶å‡½æ•°
    functions: {
        // å¿«é€ŸæŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
        quickStatus: function() {
            var session = mysql.getSession();
            
            print("=== MySQLå¿«é€ŸçŠ¶æ€æ£€æŸ¥ ===");
            
            // ç‰ˆæœ¬ä¿¡æ¯
            var version = session.runSql('SELECT VERSION()').fetchOne()[0];
            print(`MySQLç‰ˆæœ¬: ${version}`);
            
            // è¿æ¥æ•°
            var connections = session.runSql('SHOW STATUS LIKE "Threads_connected"').fetchOne()[1];
            print(`å½“å‰è¿æ¥æ•°: ${connections}`);
            
            // è¿è¡Œæ—¶é—´
            var uptime = session.runSql('SHOW STATUS LIKE "Uptime"').fetchOne()[1];
            var days = Math.floor(uptime / 86400);
            var hours = Math.floor((uptime % 86400) / 3600);
            print(`è¿è¡Œæ—¶é—´: ${days}å¤© ${hours}å°æ—¶`);
            
            // æ•°æ®åº“æ•°é‡
            var dbCount = session.runSql('SHOW DATABASES').fetchAll().length;
            print(`æ•°æ®åº“æ•°é‡: ${dbCount}`);
        },
        
        // ç£ç›˜ç©ºé—´æ£€æŸ¥
        checkDiskSpace: function(threshold = 80) {
            var session = mysql.getSession();
            
            print("=== æ•°æ®åº“ç£ç›˜ç©ºé—´æ£€æŸ¥ ===");
            
            var query = `
                SELECT 
                    table_schema AS 'æ•°æ®åº“',
                    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'å¤§å°MB'
                FROM information_schema.tables 
                WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys')
                GROUP BY table_schema 
                ORDER BY SUM(data_length + index_length) DESC
            `;
            
            var result = session.runSql(query);
            var databases = result.fetchAll();
            
            var totalSize = 0;
            for (var db of databases) {
                var size = db[1];
                totalSize += size;
                
                if (size > threshold) {
                    print(`âš ï¸  ${db[0]}: ${size} MB (è¶…è¿‡é˜ˆå€¼)`);
                } else {
                    print(`âœ… ${db[0]}: ${size} MB`);
                }
            }
            
            print(`\næ€»å¤§å°: ${totalSize.toFixed(2)} MB`);
        }
    }
};

// æ³¨å†Œæ’ä»¶åˆ°å…¨å±€å¯¹è±¡
global.my_plugin = my_plugin.functions;

// æ’ä»¶åŠ è½½æç¤º
print("ğŸ”Œ è‡ªå®šä¹‰æ’ä»¶å·²åŠ è½½ï¼");
print("å¯ç”¨å‘½ä»¤:");
print("  my_plugin.quickStatus()     - å¿«é€ŸçŠ¶æ€æ£€æŸ¥");
print("  my_plugin.checkDiskSpace()  - ç£ç›˜ç©ºé—´æ£€æŸ¥");
```

### 5.4 ä½¿ç”¨æ’ä»¶


**åŠ è½½å’Œä½¿ç”¨æ’ä»¶**ï¼š
```bash
# MySQL Shellä¼šè‡ªåŠ¨åŠ è½½ ~/.mysqlsh/plugins/ ç›®å½•ä¸‹çš„æ’ä»¶

# æˆ–è€…æ‰‹åŠ¨åŠ è½½
\source ~/.mysqlsh/plugins/my_plugin/init.js

# ä½¿ç”¨æ’ä»¶åŠŸèƒ½
my_plugin.quickStatus();
my_plugin.checkDiskSpace(100);  // è®¾ç½®é˜ˆå€¼ä¸º100MB
```

---

## 6. ğŸ“‹ æ“ä½œå®¡è®¡æ—¥å¿—


### 6.1 å®¡è®¡æ—¥å¿—çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦å®¡è®¡æ—¥å¿—**ï¼š
- **å®‰å…¨åˆè§„**ï¼šè®°å½•æ‰€æœ‰æ•°æ®åº“æ“ä½œï¼Œæ»¡è¶³å®¡è®¡è¦æ±‚
- **æ•…éšœæ’æŸ¥**ï¼šè¿½è¸ªé—®é¢˜æ“ä½œï¼Œå¿«é€Ÿå®šä½æ•…éšœåŸå› 
- **æ€§èƒ½åˆ†æ**ï¼šåˆ†ææ…¢æŸ¥è¯¢ï¼Œä¼˜åŒ–æ•°æ®åº“æ€§èƒ½
- **å˜æ›´è¿½è¸ª**ï¼šè®°å½•ç»“æ„å˜æ›´ï¼Œä¾¿äºå›æ»šå’Œåˆ†æ

### 6.2 Shellæ“ä½œè®°å½•


**å¼€å¯Shellå†å²è®°å½•**ï¼š
```javascript
// è®¾ç½®å†å²è®°å½•æ–‡ä»¶è·¯å¾„
shell.options.history.autoSave = true;
shell.options.history.maxSize = 1000;

// æŸ¥çœ‹å†å²è®°å½•é…ç½®
print("å†å²è®°å½•é…ç½®:");
print("è‡ªåŠ¨ä¿å­˜: " + shell.options.history.autoSave);
print("æœ€å¤§æ¡æ•°: " + shell.options.history.maxSize);
```

**è‡ªå®šä¹‰æ“ä½œæ—¥å¿—è®°å½•**ï¼š
```javascript
// æ“ä½œæ—¥å¿—è®°å½•å‡½æ•°
function logOperation(operation, details, result = "success") {
    var timestamp = new Date().toISOString();
    var user = session.runSql('SELECT USER()').fetchOne()[0];
    var connectionId = session.runSql('SELECT CONNECTION_ID()').fetchOne()[0];
    
    var logEntry = {
        timestamp: timestamp,
        user: user,
        connection_id: connectionId,
        operation: operation,
        details: details,
        result: result
    };
    
    // å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
    var logLine = `${timestamp} [${user}] [${connectionId}] ${operation}: ${details} - ${result}`;
    print("ğŸ“ " + logLine);
    
    return logEntry;
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šè®°å½•è¡¨åˆ›å»ºæ“ä½œ
function createTableWithLog(schema, tableName, sql) {
    try {
        var session = mysql.getSession();
        session.runSql(`USE ${schema}`);
        session.runSql(sql);
        
        logOperation(
            "CREATE_TABLE", 
            `${schema}.${tableName}`, 
            "SUCCESS"
        );
        
        print(`âœ… è¡¨ ${schema}.${tableName} åˆ›å»ºæˆåŠŸ`);
        
    } catch (error) {
        logOperation(
            "CREATE_TABLE", 
            `${schema}.${tableName}`, 
            `FAILED: ${error.message}`
        );
        
        print(`âŒ è¡¨åˆ›å»ºå¤±è´¥: ${error.message}`);
        throw error;
    }
}
```

### 6.3 é›†ç¾¤æ“ä½œå®¡è®¡


**é›†ç¾¤çŠ¶æ€å˜æ›´è®°å½•**ï¼š
```javascript
// é›†ç¾¤æ“ä½œå®¡è®¡å‡½æ•°
function auditClusterOperation(operation, nodeInfo, beforeStatus, afterStatus) {
    var auditData = {
        timestamp: new Date().toISOString(),
        operation: operation,
        node: nodeInfo,
        before_status: beforeStatus,
        after_status: afterStatus,
        operator: "admin"  // å®é™…åº”ç”¨ä¸­åº”è¯¥è·å–å½“å‰ç”¨æˆ·
    };
    
    // è®°å½•åˆ°å®¡è®¡æ—¥å¿—
    print("ğŸ” é›†ç¾¤å®¡è®¡æ—¥å¿—:");
    print(`æ—¶é—´: ${auditData.timestamp}`);
    print(`æ“ä½œ: ${auditData.operation}`);
    print(`èŠ‚ç‚¹: ${auditData.node}`);
    print(`çŠ¶æ€å˜æ›´: ${auditData.before_status} â†’ ${auditData.after_status}`);
    
    return auditData;
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šæ·»åŠ èŠ‚ç‚¹æ—¶çš„å®¡è®¡
function addInstanceWithAudit(cluster, instanceUri) {
    // è®°å½•æ“ä½œå‰çŠ¶æ€
    var beforeStatus = cluster.status();
    
    try {
        // æ‰§è¡Œæ·»åŠ èŠ‚ç‚¹æ“ä½œ
        cluster.addInstance(instanceUri);
        
        // è®°å½•æ“ä½œåçŠ¶æ€
        var afterStatus = cluster.status();
        
        // å®¡è®¡è®°å½•
        auditClusterOperation(
            "ADD_INSTANCE",
            instanceUri,
            "ONLINE_" + Object.keys(beforeStatus.defaultReplicaSet.topology).length,
            "ONLINE_" + Object.keys(afterStatus.defaultReplicaSet.topology).length
        );
        
    } catch (error) {
        auditClusterOperation(
            "ADD_INSTANCE",
            instanceUri,
            "FAILED",
            error.message
        );
        throw error;
    }
}
```

---

## 7. âš¡ Shellæ€§èƒ½ä¼˜åŒ–


### 7.1 è¿æ¥æ± ä¼˜åŒ–


**ä»€ä¹ˆæ˜¯è¿æ¥æ± **ï¼šè¿æ¥æ± å°±åƒåœè½¦åœºï¼Œé¢„å…ˆå‡†å¤‡å¥½å¤šä¸ªæ•°æ®åº“è¿æ¥ï¼Œéœ€è¦æ—¶ç›´æ¥ä½¿ç”¨ï¼Œç”¨å®Œåå½’è¿˜ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥çš„å¼€é”€ã€‚

**è¿æ¥æ± é…ç½®**ï¼š
```javascript
// é…ç½®è¿æ¥æ± å‚æ•°
shell.options.connectTimeout = 10;  // è¿æ¥è¶…æ—¶10ç§’
shell.options.dba.connectTimeout = 30;  // DBAæ“ä½œè¶…æ—¶30ç§’

// å¤ç”¨è¿æ¥ç¤ºä¾‹
var connectionPool = {
    connections: {},
    
    // è·å–è¿æ¥ï¼ˆå¤ç”¨å·²æœ‰è¿æ¥ï¼‰
    getConnection: function(uri) {
        if (!this.connections[uri]) {
            print(`ğŸ”— åˆ›å»ºæ–°è¿æ¥: ${uri}`);
            this.connections[uri] = mysql.getSession(uri);
        } else {
            print(`â™»ï¸  å¤ç”¨è¿æ¥: ${uri}`);
        }
        return this.connections[uri];
    },
    
    // å…³é—­æ‰€æœ‰è¿æ¥
    closeAll: function() {
        for (var uri in this.connections) {
            this.connections[uri].close();
            print(`âŒ å…³é—­è¿æ¥: ${uri}`);
        }
        this.connections = {};
    }
};

// ä½¿ç”¨è¿æ¥æ± 
var session1 = connectionPool.getConnection('admin@localhost:3306');
var session2 = connectionPool.getConnection('admin@localhost:3306');  // å¤ç”¨è¿æ¥
```

### 7.2 æ‰¹é‡æ“ä½œä¼˜åŒ–


**æ‰¹é‡vså•æ¡æ“ä½œå¯¹æ¯”**ï¼š
```javascript
// âŒ ä½æ•ˆæ–¹å¼ï¼šé€æ¡æ’å…¥
function inefficientInsert(data) {
    var session = mysql.getSession();
    var startTime = new Date();
    
    for (var i = 0; i < data.length; i++) {
        session.runSql(
            'INSERT INTO users (name, email) VALUES (?, ?)',
            [data[i].name, data[i].email]
        );
    }
    
    var endTime = new Date();
    print(`é€æ¡æ’å…¥${data.length}æ¡è®°å½•è€—æ—¶: ${endTime - startTime}ms`);
}

// âœ… é«˜æ•ˆæ–¹å¼ï¼šæ‰¹é‡æ’å…¥
function efficientInsert(data) {
    var session = mysql.getSession();
    var startTime = new Date();
    
    // æ„å»ºæ‰¹é‡æ’å…¥SQL
    var values = [];
    var params = [];
    
    for (var i = 0; i < data.length; i++) {
        values.push('(?, ?)');
        params.push(data[i].name, data[i].email);
    }
    
    var sql = 'INSERT INTO users (name, email) VALUES ' + values.join(', ');
    session.runSql(sql, params);
    
    var endTime = new Date();
    print(`æ‰¹é‡æ’å…¥${data.length}æ¡è®°å½•è€—æ—¶: ${endTime - startTime}ms`);
}
```

### 7.3 æŸ¥è¯¢ç»“æœä¼˜åŒ–


**åˆ†é¡µæŸ¥è¯¢å‡å°‘å†…å­˜å ç”¨**ï¼š
```javascript
// å¤§æ•°æ®é‡æŸ¥è¯¢çš„ä¼˜åŒ–å¤„ç†
function processLargeDataset(tableName, batchSize = 1000) {
    var session = mysql.getSession();
    var offset = 0;
    var processedCount = 0;
    
    while (true) {
        // åˆ†æ‰¹æŸ¥è¯¢
        var sql = `SELECT * FROM ${tableName} LIMIT ${batchSize} OFFSET ${offset}`;
        var result = session.runSql(sql);
        var rows = result.fetchAll();
        
        // æ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œé€€å‡ºå¾ªç¯
        if (rows.length === 0) {
            break;
        }
        
        // å¤„ç†å½“å‰æ‰¹æ¬¡æ•°æ®
        for (var row of rows) {
            // è¿™é‡Œæ˜¯ä½ çš„ä¸šåŠ¡é€»è¾‘
            processedCount++;
        }
        
        print(`å·²å¤„ç† ${processedCount} æ¡è®°å½•...`);
        
        // æ›´æ–°åç§»é‡
        offset += batchSize;
        
        // é¿å…å†…å­˜æº¢å‡ºï¼Œå¯ä»¥æ·»åŠ å»¶è¿Ÿ
        // session.runSql('SELECT SLEEP(0.1)');  // å»¶è¿Ÿ100ms
    }
    
    print(`âœ… æ€»å…±å¤„ç†äº† ${processedCount} æ¡è®°å½•`);
}
```

---

## 8. ğŸ”’ Shellå®‰å…¨é…ç½®


### 8.1 è®¤è¯å’Œæˆæƒ


**å®‰å…¨è¿æ¥é…ç½®**ï¼š
```javascript
// ä½¿ç”¨SSLè¿æ¥
var secureSession = mysql.getSession({
    host: 'localhost',
    port: 3306,
    user: 'admin',
    password: 'password',
    ssl: {
        mode: 'REQUIRED',           // å¿…é¡»ä½¿ç”¨SSL
        ca: '/path/to/ca.pem',      // CAè¯ä¹¦
        cert: '/path/to/cert.pem',  // å®¢æˆ·ç«¯è¯ä¹¦
        key: '/path/to/key.pem'     // å®¢æˆ·ç«¯ç§é’¥
    }
});

// éªŒè¯è¿æ¥æ˜¯å¦åŠ å¯†
var sslStatus = secureSession.runSql('SHOW STATUS LIKE "Ssl_cipher"').fetchOne();
if (sslStatus[1]) {
    print(`âœ… SSLè¿æ¥å·²å»ºç«‹ï¼ŒåŠ å¯†ç®—æ³•: ${sslStatus[1]}`);
} else {
    print("âŒ æœªä½¿ç”¨SSLè¿æ¥");
}
```

**æƒé™æ£€æŸ¥å‡½æ•°**ï¼š
```javascript
// æ£€æŸ¥å½“å‰ç”¨æˆ·æƒé™
function checkUserPrivileges() {
    var session = mysql.getSession();
    
    // è·å–å½“å‰ç”¨æˆ·
    var currentUser = session.runSql('SELECT USER()').fetchOne()[0];
    print(`å½“å‰ç”¨æˆ·: ${currentUser}`);
    
    // æ£€æŸ¥å…¨å±€æƒé™
    var globalPrivs = session.runSql('SHOW GRANTS').fetchAll();
    print("\nå…¨å±€æƒé™:");
    for (var priv of globalPrivs) {
        print(`  ${priv[0]}`);
    }
    
    // æ£€æŸ¥æ˜¯å¦æœ‰å±é™©æƒé™
    var dangerousPrivs = ['SUPER', 'FILE', 'PROCESS', 'RELOAD', 'SHUTDOWN'];
    var hasHigh = false;
    
    for (var priv of globalPrivs) {
        var privText = priv[0].toUpperCase();
        for (var dangerous of dangerousPrivs) {
            if (privText.includes(dangerous)) {
                print(`âš ï¸  è­¦å‘Šï¼šç”¨æˆ·æ‹¥æœ‰é«˜å±æƒé™ ${dangerous}`);
                hasHigh = true;
            }
        }
    }
    
    if (!hasHigh) {
        print("âœ… ç”¨æˆ·æƒé™å®‰å…¨");
    }
}
```

### 8.2 å¯†ç å’Œæ•æ„Ÿä¿¡æ¯ä¿æŠ¤


**å®‰å…¨çš„å¯†ç å¤„ç†**ï¼š
```javascript
// âŒ ä¸å®‰å…¨ï¼šå¯†ç æ˜æ–‡
var badSession = mysql.getSession('admin:password123@localhost:3306');

// âœ… å®‰å…¨ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
var safeSession = mysql.getSession({
    host: 'localhost',
    port: 3306,
    user: 'admin',
    password: os.getenv('MYSQL_PASSWORD')  // ä»ç¯å¢ƒå˜é‡è¯»å–
});

// âœ… å®‰å…¨ï¼šäº¤äº’å¼è¾“å…¥å¯†ç 
var interactiveSession = mysql.getSession({
    host: 'localhost',
    port: 3306,
    user: 'admin'
    // å¯†ç ä¼šæç¤ºç”¨æˆ·è¾“å…¥ï¼Œä¸ä¼šæ˜¾ç¤ºåœ¨è„šæœ¬ä¸­
});
```

**æ•æ„Ÿæ“ä½œè®°å½•**ï¼š
```javascript
// è®°å½•æ•æ„Ÿæ“ä½œçš„å®‰å…¨æ—¥å¿—
function secureLogOperation(operation, target, result) {
    var logEntry = {
        timestamp: new Date().toISOString(),
        user: session.runSql('SELECT USER()').fetchOne()[0],
        client_ip: session.runSql('SELECT $$hostname').fetchOne()[0],
        operation: operation,
        target: target,
        result: result,
        severity: getSeverityLevel(operation)
    };
    
    // é«˜å±æ“ä½œç‰¹æ®Šæ ‡è®°
    if (logEntry.severity === 'HIGH') {
        print(`ğŸš¨ é«˜å±æ“ä½œè®°å½•: ${operation} on ${target}`);
    }
    
    return logEntry;
}

function getSeverityLevel(operation) {
    var highRiskOps = ['DROP', 'DELETE', 'TRUNCATE', 'ALTER'];
    var mediumRiskOps = ['UPDATE', 'INSERT', 'CREATE'];
    
    for (var op of highRiskOps) {
        if (operation.toUpperCase().includes(op)) {
            return 'HIGH';
        }
    }
    
    for (var op of mediumRiskOps) {
        if (operation.toUpperCase().includes(op)) {
            return 'MEDIUM';
        }
    }
    
    return 'LOW';
}
```

---

## 9. ğŸŒ è¿œç¨‹æ“ä½œç®¡ç†


### 9.1 è¿œç¨‹è¿æ¥ç®¡ç†


**å¤šå®ä¾‹è¿æ¥ç®¡ç†**ï¼š
```javascript
// è¿œç¨‹å®ä¾‹è¿æ¥ç®¡ç†å™¨
var RemoteManager = {
    instances: {},
    
    // æ·»åŠ è¿œç¨‹å®ä¾‹
    addInstance: function(name, config) {
        try {
            var session = mysql.getSession({
                host: config.host,
                port: config.port || 3306,
                user: config.user,
                password: config.password,
                connectTimeout: config.timeout || 10
            });
            
            // æµ‹è¯•è¿æ¥
            var version = session.runSql('SELECT VERSION()').fetchOne()[0];
            
            this.instances[name] = {
                session: session,
                config: config,
                version: version,
                connected: true,
                lastCheck: new Date()
            };
            
            print(`âœ… è¿œç¨‹å®ä¾‹å·²è¿æ¥: ${name} (${config.host}:${config.port})`);
            print(`   MySQLç‰ˆæœ¬: ${version}`);
            
        } catch (error) {
            print(`âŒ è¿æ¥å¤±è´¥: ${name} - ${error.message}`);
            this.instances[name] = {
                config: config,
                connected: false,
                error: error.message,
                lastCheck: new Date()
            };
        }
    },
    
    // è·å–å®ä¾‹è¿æ¥
    getInstance: function(name) {
        if (!this.instances[name]) {
            throw new Error(`å®ä¾‹ ${name} ä¸å­˜åœ¨`);
        }
        
        if (!this.instances[name].connected) {
            throw new Error(`å®ä¾‹ ${name} æœªè¿æ¥`);
        }
        
        return this.instances[name].session;
    },
    
    // æ£€æŸ¥æ‰€æœ‰å®ä¾‹çŠ¶æ€
    checkAllInstances: function() {
        print("=== è¿œç¨‹å®ä¾‹çŠ¶æ€æ£€æŸ¥ ===");
        
        for (var name in this.instances) {
            var instance = this.instances[name];
            
            if (instance.connected) {
                try {
                    // æ‰§è¡Œç®€å•æŸ¥è¯¢æµ‹è¯•è¿æ¥
                    instance.session.runSql('SELECT 1');
                    print(`âœ… ${name}: åœ¨çº¿ (${instance.config.host})`);
                } catch (error) {
                    print(`âŒ ${name}: è¿æ¥ä¸­æ–­ - ${error.message}`);
                    instance.connected = false;
                }
            } else {
                print(`âŒ ${name}: ç¦»çº¿ - ${instance.error || 'æœªçŸ¥é”™è¯¯'}`);
            }
        }
    }
};

// ä½¿ç”¨ç¤ºä¾‹
RemoteManager.addInstance('prod_master', {
    host: '192.168.1.100',
    port: 3306,
    user: 'admin',
    password: 'prod_password'
});

RemoteManager.addInstance('backup_slave', {
    host: '192.168.1.101',
    port: 3306,
    user: 'readonly',
    password: 'backup_password'
});
```

### 9.2 é›†ç¾¤è¿œç¨‹ç®¡ç†


**è¿œç¨‹é›†ç¾¤æ“ä½œ**ï¼š
```javascript
// è¿œç¨‹é›†ç¾¤ç®¡ç†
function manageRemoteCluster(clusterHost, adminUser, adminPassword) {
    // è¿æ¥åˆ°é›†ç¾¤çš„ç®¡ç†èŠ‚ç‚¹
    var adminSession = mysql.getSession({
        host: clusterHost,
        port: 3306,
        user: adminUser,
        password: adminPassword
    });
    
    // è·å–é›†ç¾¤å¯¹è±¡
    var cluster = dba.getCluster();
    
    print("=== è¿œç¨‹é›†ç¾¤çŠ¶æ€ ===");
    
    // æ£€æŸ¥é›†ç¾¤çŠ¶æ€
    var status = cluster.status();
    print(`é›†ç¾¤åç§°: ${status.clusterName}`);
    print(`é›†ç¾¤çŠ¶æ€: ${status.defaultReplicaSet.status}`);
    
    // æ£€æŸ¥å„èŠ‚ç‚¹çŠ¶æ€
    var topology = status.defaultReplicaSet.topology;
    for (var instance in topology) {
        var node = topology[instance];
        var status_icon = node.status === 'ONLINE' ? 'âœ…' : 'âŒ';
        print(`${status_icon} ${instance}: ${node.status} (${node.role})`);
    }
    
    // è¿”å›é›†ç¾¤å¯¹è±¡ä¾›è¿›ä¸€æ­¥æ“ä½œ
    return cluster;
}

// è¿œç¨‹æ·»åŠ å®ä¾‹
function addRemoteInstance(cluster, newInstanceHost, newInstancePort = 3306) {
    try {
        var newInstanceUri = `admin@${newInstanceHost}:${newInstancePort}`;
        
        print(`æ­£åœ¨æ·»åŠ è¿œç¨‹å®ä¾‹: ${newInstanceUri}`);
        
        // æ£€æŸ¥å®ä¾‹æ˜¯å¦å¯è¾¾
        var testSession = mysql.getSession(newInstanceUri);
        testSession.close();
        
        // æ·»åŠ åˆ°é›†ç¾¤
        cluster.addInstance(newInstanceUri, {
            recoveryMethod: 'clone',  // ä½¿ç”¨å…‹éš†æ¢å¤
            waitRecovery: 2          // ç­‰å¾…æ¢å¤å®Œæˆçš„çº§åˆ«
        });
        
        print(`âœ… å®ä¾‹æ·»åŠ æˆåŠŸ: ${newInstanceUri}`);
        
    } catch (error) {
        print(`âŒ æ·»åŠ å®ä¾‹å¤±è´¥: ${error.message}`);
        throw error;
    }
}
```

### 9.3 è·¨åœ°åŸŸå¤‡ä»½ç®¡ç†


**è¿œç¨‹å¤‡ä»½æ“ä½œ**ï¼š
```javascript
// è·¨åœ°åŸŸå¤‡ä»½ç®¡ç†
function crossRegionBackup(sourceConfig, backupConfig) {
    print("=== å¼€å§‹è·¨åœ°åŸŸå¤‡ä»½ ===");
    
    // è¿æ¥æºæ•°æ®åº“
    var sourceSession = mysql.getSession(sourceConfig);
    print(`âœ… è¿æ¥æºæ•°æ®åº“: ${sourceConfig.host}`);
    
    // è¿æ¥å¤‡ä»½æ•°æ®åº“  
    var backupSession = mysql.getSession(backupConfig);
    print(`âœ… è¿æ¥å¤‡ä»½æ•°æ®åº“: ${backupConfig.host}`);
    
    try {
        // è·å–æºæ•°æ®åº“åˆ—è¡¨
        var databases = sourceSession.runSql(
            'SHOW DATABASES WHERE `Database` NOT IN ("information_schema", "performance_schema", "mysql", "sys")'
        ).fetchAll();
        
        for (var db of databases) {
            var dbName = db[0];
            print(`ğŸ“¦ å¤‡ä»½æ•°æ®åº“: ${dbName}`);
            
            // å¯¼å‡ºæ•°æ®åº“ç»“æ„
            util.dumpSchemas([dbName], `/tmp/${dbName}_structure.sql`, {
                dryRun: false,
                dumper: "schema",
                includeSchemas: [dbName]
            });
            
            // åœ¨å¤‡ä»½æœåŠ¡å™¨ä¸Šæ¢å¤ç»“æ„
            util.loadDump(`/tmp/${dbName}_structure.sql`, {
                schema: dbName,
                createInvisiblePKs: true
            });
            
            print(`âœ… ${dbName} å¤‡ä»½å®Œæˆ`);
        }
        
        print("ğŸ‰ è·¨åœ°åŸŸå¤‡ä»½å…¨éƒ¨å®Œæˆ");
        
    } catch (error) {
        print(`âŒ å¤‡ä»½å¤±è´¥: ${error.message}`);
        throw error;
    } finally {
        sourceSession.close();
        backupSession.close();
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```markdown
ğŸ”¸ **MySQL Shellæœ¬è´¨**: å¢å¼ºç‰ˆMySQLå®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šè¯­è¨€å’Œé›†ç¾¤ç®¡ç†
ğŸ”¸ **ä¸‰ç§æ¨¡å¼**: SQLã€JavaScriptã€Pythonæ¨¡å¼ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯  
ğŸ”¸ **è„šæœ¬åŒ–èƒ½åŠ›**: æ”¯æŒå¤æ‚çš„è‡ªåŠ¨åŒ–è„šæœ¬å¼€å‘å’Œæ‰§è¡Œ
ğŸ”¸ **æ‰¹é‡æ“ä½œ**: æä¾›é«˜æ•ˆçš„æ‰¹é‡æ•°æ®å¯¼å…¥å¯¼å‡ºAPI
ğŸ”¸ **æ’ä»¶æœºåˆ¶**: å¯æ‰©å±•çš„æ’ä»¶ç³»ç»Ÿï¼Œæ”¯æŒè‡ªå®šä¹‰åŠŸèƒ½
ğŸ”¸ **å®‰å…¨ç‰¹æ€§**: æ”¯æŒSSLã€æƒé™æ§åˆ¶ã€æ“ä½œå®¡è®¡
ğŸ”¸ **è¿œç¨‹ç®¡ç†**: å¼ºå¤§çš„è¿œç¨‹å®ä¾‹å’Œé›†ç¾¤ç®¡ç†èƒ½åŠ›
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Shell vs ä¼ ç»Ÿå®¢æˆ·ç«¯çš„ä¼˜åŠ¿**
```markdown
ä¼ ç»Ÿæ–¹å¼çš„å±€é™:
- åªèƒ½æ‰§è¡ŒSQLï¼ŒåŠŸèƒ½å•ä¸€
- æ— æ³•è¿›è¡Œå¤æ‚çš„æ‰¹é‡æ“ä½œ  
- ç¼ºä¹è‡ªåŠ¨åŒ–å’Œè„šæœ¬èƒ½åŠ›
- é›†ç¾¤ç®¡ç†éœ€è¦é¢å¤–å·¥å…·

MySQL Shellçš„ä¼˜åŠ¿:
- å¤šè¯­è¨€æ”¯æŒï¼ŒåŠŸèƒ½ä¸°å¯Œ
- å†…ç½®æ‰¹é‡æ“ä½œAPI
- å¼ºå¤§çš„è„šæœ¬å¼€å‘èƒ½åŠ›
- ä¸“ä¸šçš„é›†ç¾¤ç®¡ç†åŠŸèƒ½
```

**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Shell**
```markdown
é€‚åˆä½¿ç”¨Shellçš„åœºæ™¯:
âœ… éœ€è¦è‡ªåŠ¨åŒ–æ•°æ®åº“ç®¡ç†ä»»åŠ¡
âœ… æ‰¹é‡æ•°æ®å¯¼å…¥å¯¼å‡ºæ“ä½œ
âœ… InnoDB Clusteré›†ç¾¤ç®¡ç†
âœ… å¤æ‚çš„æ•°æ®åº“ç»´æŠ¤è„šæœ¬
âœ… è·¨å®ä¾‹çš„ç®¡ç†æ“ä½œ

ç»§ç»­ä½¿ç”¨ä¼ ç»Ÿå®¢æˆ·ç«¯çš„åœºæ™¯:
- ç®€å•çš„æŸ¥è¯¢æ“ä½œ
- ä¸´æ—¶çš„æ•°æ®æŸ¥çœ‹
- å­¦ä¹ SQLè¯­æ³•
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å…³é”®åŸåˆ™**
```markdown
è¿æ¥ä¼˜åŒ–:
- ä½¿ç”¨è¿æ¥æ± å‡å°‘è¿æ¥å¼€é”€
- é…ç½®åˆé€‚çš„è¶…æ—¶å‚æ•°

æ“ä½œä¼˜åŒ–:  
- æ‰¹é‡æ“ä½œä»£æ›¿å•æ¡æ“ä½œ
- åˆ†é¡µå¤„ç†å¤§æ•°æ®é›†
- åˆç†ä½¿ç”¨äº‹åŠ¡

èµ„æºä¼˜åŒ–:
- åŠæ—¶å…³é—­ä¸ç”¨çš„è¿æ¥
- æ§åˆ¶å†…å­˜ä½¿ç”¨é‡
- é¿å…é•¿æ—¶é—´å ç”¨èµ„æº
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š å¼€å‘å»ºè®®**
```markdown
è„šæœ¬å¼€å‘è§„èŒƒ:
1. ä½¿ç”¨å‡½æ•°å°è£…å¸¸ç”¨æ“ä½œ
2. æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
3. ç¼–å†™æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£
4. æµ‹è¯•è„šæœ¬çš„å„ç§åœºæ™¯

å®‰å…¨æœ€ä½³å®è·µ:
1. ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†ç 
2. å¯ç”¨SSLè¿æ¥åŠ å¯†
3. è®°å½•æ•æ„Ÿæ“ä½œæ—¥å¿—
4. å®šæœŸæ£€æŸ¥ç”¨æˆ·æƒé™

æ€§èƒ½æœ€ä½³å®è·µ:
1. ä½¿ç”¨æ‰¹é‡æ“ä½œAPI
2. å®ç°è¿æ¥æ± ç®¡ç†
3. åˆ†æ‰¹å¤„ç†å¤§æ•°æ®
4. ç›‘æ§æ“ä½œæ€§èƒ½
```

**ğŸ› ï¸ å¸¸ç”¨æ“ä½œæ¨¡æ¿**
```markdown
æ—¥å¸¸ç»´æŠ¤è„šæœ¬:
- æ•°æ®åº“çŠ¶æ€æ£€æŸ¥
- è¡¨ç»´æŠ¤æ“ä½œ
- ç£ç›˜ç©ºé—´ç›‘æ§
- å¤‡ä»½éªŒè¯è„šæœ¬

é›†ç¾¤ç®¡ç†è„šæœ¬:
- èŠ‚ç‚¹å¥åº·æ£€æŸ¥
- è‡ªåŠ¨æ•…éšœè½¬ç§»
- é›†ç¾¤é…ç½®å¤‡ä»½
- æ€§èƒ½ç›‘æ§æŠ¥å‘Š

æ•°æ®å¤„ç†è„šæœ¬:
- æ‰¹é‡æ•°æ®å¯¼å…¥
- æ•°æ®æ¸…ç†ä»»åŠ¡
- æŠ¥è¡¨ç”Ÿæˆè„šæœ¬
- æ•°æ®åŒæ­¥ä»»åŠ¡
```

### 10.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å­¦ä¹ é¡ºåº**
```markdown
ç¬¬ä¸€é˜¶æ®µ - åŸºç¡€æŒæ¡:
1. ç†è§£Shellçš„ä¸‰ç§æ¨¡å¼
2. å­¦ä¼šåŸºæœ¬çš„è„šæœ¬ç¼–å†™  
3. æŒæ¡å¸¸ç”¨çš„ç®¡ç†API
4. ç»ƒä¹ ç®€å•çš„è‡ªåŠ¨åŒ–ä»»åŠ¡

ç¬¬äºŒé˜¶æ®µ - æ·±å…¥åº”ç”¨:
1. å¼€å‘è‡ªå®šä¹‰å‡½æ•°åº“
2. å­¦ä¹ æ’ä»¶å¼€å‘æœºåˆ¶
3. æŒæ¡æ‰¹é‡æ“ä½œæŠ€å·§
4. å®ç°å®‰å…¨é…ç½®ç®¡ç†

ç¬¬ä¸‰é˜¶æ®µ - é«˜çº§åº”ç”¨:
1. è¿œç¨‹é›†ç¾¤ç®¡ç†
2. è·¨åœ°åŸŸå¤‡ä»½ç­–ç•¥
3. æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–
4. ä¼ä¸šçº§è‡ªåŠ¨åŒ–æ–¹æ¡ˆ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- MySQL Shellæ˜¯æ•°æ®åº“ç®¡ç†çš„ç‘å£«å†›åˆ€
- è„šæœ¬åŒ–è®©é‡å¤å·¥ä½œè‡ªåŠ¨åŒ–
- æ‰¹é‡æ“ä½œæå‡å¤„ç†æ•ˆç‡
- å®‰å…¨é…ç½®ä¿æŠ¤æ•°æ®å®‰å…¨
- è¿œç¨‹ç®¡ç†å®ç°é›†ä¸­æ§åˆ¶