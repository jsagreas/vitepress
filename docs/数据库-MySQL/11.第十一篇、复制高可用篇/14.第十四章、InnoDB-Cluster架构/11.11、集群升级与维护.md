---
title: 11ã€é›†ç¾¤å‡çº§ä¸ç»´æŠ¤
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤å‡çº§åŸºç¡€æ¦‚å¿µ](#1-é›†ç¾¤å‡çº§åŸºç¡€æ¦‚å¿µ)
2. [åœ¨çº¿æ»šåŠ¨å‡çº§å®ç°](#2-åœ¨çº¿æ»šåŠ¨å‡çº§å®ç°)
3. [ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†](#3-ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†)
4. [å‡çº§é£é™©è¯„ä¼°](#4-å‡çº§é£é™©è¯„ä¼°)
5. [é…ç½®è¿ç§»ç­–ç•¥](#5-é…ç½®è¿ç§»ç­–ç•¥)
6. [æ•°æ®å®Œæ•´æ€§éªŒè¯](#6-æ•°æ®å®Œæ•´æ€§éªŒè¯)
7. [å‡çº§å›æ»šæœºåˆ¶](#7-å‡çº§å›æ»šæœºåˆ¶)
8. [ç»´æŠ¤çª—å£ç®¡ç†](#8-ç»´æŠ¤çª—å£ç®¡ç†)
9. [å˜æ›´å½±å“åˆ†æ](#9-å˜æ›´å½±å“åˆ†æ)
10. [é›¶åœæœºå‡çº§å®ç°åŸç†](#10-é›¶åœæœºå‡çº§å®ç°åŸç†)
11. [å¤§ç‰ˆæœ¬å‡çº§æ•°æ®è¿ç§»](#11-å¤§ç‰ˆæœ¬å‡çº§æ•°æ®è¿ç§»)
12. [å‡çº§è‡ªåŠ¨åŒ–ç¼–æ’](#12-å‡çº§è‡ªåŠ¨åŒ–ç¼–æ’)
13. [ç»´æŠ¤å½±å“æœ€å°åŒ–æŠ€æœ¯](#13-ç»´æŠ¤å½±å“æœ€å°åŒ–æŠ€æœ¯)
14. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#14-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é›†ç¾¤å‡çº§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯InnoDB Clusterå‡çº§


**ğŸ“– ç®€å•ç†è§£**ï¼š
é›†ç¾¤å‡çº§å°±åƒç»™æ•´ä¸ªå›¢é˜Ÿæ¢æ–°çš„å·¥ä½œæœè£…ï¼Œä½†ä¸èƒ½è®©ä¸šåŠ¡åœä¸‹æ¥ã€‚æƒ³è±¡ä¸€ä¸ª24å°æ—¶è¥ä¸šçš„ä¾¿åˆ©åº—ï¼Œéœ€è¦ç»™æ‰€æœ‰å‘˜å·¥æ¢æ–°åˆ¶æœï¼Œä½†åº—é“ºä¸èƒ½å…³é—¨ã€‚

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
InnoDB Clusterå‡çº§ï¼šåœ¨ä¿æŒæœåŠ¡å¯ç”¨æ€§çš„å‰æä¸‹ï¼Œ
å°†é›†ç¾¤ä¸­çš„MySQLå®ä¾‹ä»æ—§ç‰ˆæœ¬å‡çº§åˆ°æ–°ç‰ˆæœ¬çš„è¿‡ç¨‹

å…³é”®ç‰¹ç‚¹ï¼š
â€¢ ä¸šåŠ¡è¿ç»­æ€§ï¼šå‡çº§æœŸé—´åº”ç”¨å¯ä»¥æ­£å¸¸è®¿é—®æ•°æ®åº“
â€¢ æ•°æ®å®‰å…¨æ€§ï¼šç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ã€ä¸æŸå
â€¢ æœåŠ¡å¯ç”¨æ€§ï¼šæœ€å°åŒ–åœæœºæ—¶é—´ï¼Œç†æƒ³çŠ¶æ€ä¸‹é›¶åœæœº
```

### 1.2 å‡çº§çš„åŸºæœ¬ç±»å‹


**ğŸ”¹ æŒ‰ç‰ˆæœ¬è·¨åº¦åˆ†ç±»**
```
ğŸŸ¢ å°ç‰ˆæœ¬å‡çº§ (Patchå‡çº§)ï¼š
ç¤ºä¾‹ï¼šMySQL 8.0.35 â†’ 8.0.36
ç‰¹ç‚¹ï¼šä¸»è¦æ˜¯Bugä¿®å¤å’Œå®‰å…¨è¡¥ä¸
é£é™©ï¼šä½ï¼Œé€šå¸¸å‘ä¸‹å…¼å®¹

ğŸŸ¡ ä¸­ç‰ˆæœ¬å‡çº§ (Minorå‡çº§)ï¼š
ç¤ºä¾‹ï¼šMySQL 8.0.x â†’ 8.1.x
ç‰¹ç‚¹ï¼šæ–°åŠŸèƒ½å’Œæ€§èƒ½æ”¹è¿›
é£é™©ï¼šä¸­ç­‰ï¼Œéœ€è¦æµ‹è¯•å…¼å®¹æ€§

ğŸ”´ å¤§ç‰ˆæœ¬å‡çº§ (Majorå‡çº§)ï¼š
ç¤ºä¾‹ï¼šMySQL 8.0.x â†’ 9.0.x
ç‰¹ç‚¹ï¼šæ¶æ„å˜åŒ–å’Œé‡å¤§åŠŸèƒ½æ›´æ–°
é£é™©ï¼šé«˜ï¼Œå¯èƒ½æœ‰ç ´åæ€§å˜æ›´
```

**ğŸ”¹ æŒ‰å‡çº§æ–¹å¼åˆ†ç±»**
```
åœ¨çº¿å‡çº§ï¼šä¸šåŠ¡ä¸åœæœºï¼Œé€ä¸ªèŠ‚ç‚¹å‡çº§
ç¦»çº¿å‡çº§ï¼šé›†ç¾¤æ•´ä½“åœæœºå‡çº§
æ··åˆå‡çº§ï¼šéƒ¨åˆ†åœ¨çº¿ï¼Œéƒ¨åˆ†ç¦»çº¿
```

### 1.3 å‡çº§å‰ç½®æ¡ä»¶


**ğŸ“‹ ç¯å¢ƒå‡†å¤‡æ£€æŸ¥æ¸…å•**
- [ ] **ç¡¬ä»¶èµ„æºå……è¶³**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ç©ºé—´æ»¡è¶³æ–°ç‰ˆæœ¬è¦æ±‚
- [ ] **ç½‘ç»œè¿æ¥ç¨³å®š**ï¼šé›†ç¾¤èŠ‚ç‚¹é—´é€šä¿¡æ­£å¸¸
- [ ] **å¤‡ä»½å®Œæ•´å¯ç”¨**ï¼šæœ€æ–°çš„å…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½
- [ ] **æµ‹è¯•ç¯å¢ƒéªŒè¯**ï¼šæ–°ç‰ˆæœ¬åœ¨æµ‹è¯•ç¯å¢ƒè¿è¡Œæ­£å¸¸
- [ ] **å›æ»šæ–¹æ¡ˆå‡†å¤‡**ï¼šè¯¦ç»†çš„å›æ»šæ­¥éª¤å’Œæ—¶é—´è®¡åˆ’

---

## 2. ğŸ”„ åœ¨çº¿æ»šåŠ¨å‡çº§å®ç°


### 2.1 æ»šåŠ¨å‡çº§åŸºæœ¬åŸç†


**ğŸ’¡ ç”Ÿæ´»åŒ–ç±»æ¯”**ï¼š
å°±åƒä¸€ä¸ªä¸‰äººå€¼ç­åˆ¶çš„åŒ»é™¢ï¼Œéœ€è¦ç»™æ‰€æœ‰åŒ»ç”ŸåŸ¹è®­æ–°æŠ€èƒ½ã€‚ä¸èƒ½ä¸‰ä¸ªäººåŒæ—¶å»åŸ¹è®­ï¼ˆä¼šæ²¡äººå€¼ç­ï¼‰ï¼Œæ‰€ä»¥ä¸€ä¸ªä¸€ä¸ªè½®æµå»ï¼Œè¿™æ ·åŒ»é™¢æ°¸è¿œæœ‰äººåœ¨å·¥ä½œã€‚

**ğŸ”¸ å·¥ä½œæœºåˆ¶**
```
InnoDB Clusteræ»šåŠ¨å‡çº§æµç¨‹ï¼š

1. ä»SecondaryèŠ‚ç‚¹å¼€å§‹å‡çº§
   â†“
2. ç­‰å¾…æ•°æ®åŒæ­¥å®Œæˆ
   â†“  
3. ç»§ç»­ä¸‹ä¸€ä¸ªSecondaryèŠ‚ç‚¹
   â†“
4. æœ€åå‡çº§PrimaryèŠ‚ç‚¹
   â†“
5. éªŒè¯é›†ç¾¤çŠ¶æ€å’Œæ•°æ®ä¸€è‡´æ€§
```

### 2.2 æ»šåŠ¨å‡çº§è¯¦ç»†æ­¥éª¤


**ğŸ”§ å®æ–½æ­¥éª¤è¯¦è§£**

**Step 1: å‡çº§å‰å‡†å¤‡** âš™ï¸
```bash
# 1. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
mysqlsh> cluster.status()

# 2. åˆ›å»ºå®Œæ•´å¤‡ä»½
mysqlsh> util.dumpInstance("backup_before_upgrade")

# 3. éªŒè¯æ‰€æœ‰èŠ‚ç‚¹æ•°æ®åŒæ­¥
mysqlsh> cluster.checkInstanceState()
```

**Step 2: å‡çº§SecondaryèŠ‚ç‚¹** ğŸ”„
```bash
# 1. é€‰æ‹©ä¸€ä¸ªSecondaryèŠ‚ç‚¹
# 2. åœæ­¢MySQLæœåŠ¡
systemctl stop mysql

# 3. å®‰è£…æ–°ç‰ˆæœ¬MySQL
# - å¤‡ä»½åŸé…ç½®æ–‡ä»¶
# - å®‰è£…æ–°ç‰ˆæœ¬è½¯ä»¶åŒ…
# - æ¢å¤é…ç½®æ–‡ä»¶

# 4. å¯åŠ¨å¹¶éªŒè¯
systemctl start mysql
mysql_upgrade --upgrade-system-tables
```

**Step 3: éªŒè¯èŠ‚ç‚¹çŠ¶æ€** âœ…
```javascript
// æ£€æŸ¥å‡çº§åçš„èŠ‚ç‚¹çŠ¶æ€
mysqlsh> cluster.status()
// ç¡®è®¤ï¼š
// - èŠ‚ç‚¹çŠ¶æ€ä¸ºONLINE
// - æ•°æ®åŒæ­¥æ­£å¸¸
// - æ²¡æœ‰é”™è¯¯ä¿¡æ¯
```

**Step 4: ç»§ç»­å…¶ä»–SecondaryèŠ‚ç‚¹** ğŸ”
é‡å¤Step 2å’ŒStep 3ï¼Œç›´åˆ°æ‰€æœ‰SecondaryèŠ‚ç‚¹å‡çº§å®Œæˆ

**Step 5: å‡çº§PrimaryèŠ‚ç‚¹** ğŸ¯
```bash
# 1. å¦‚æœéœ€è¦ï¼Œå…ˆè¿›è¡Œä¸»ä»åˆ‡æ¢
mysqlsh> cluster.setPrimaryInstance('secondary-node:3306')

# 2. å‡çº§åŸPrimaryèŠ‚ç‚¹ï¼ˆç°åœ¨æ˜¯Secondaryï¼‰
# 3. å¯é€‰ï¼šåˆ‡æ¢å›åŸPrimaryèŠ‚ç‚¹
```

### 2.3 å‡çº§è¿‡ç¨‹ç›‘æ§


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```
è¿æ¥æ•°ç›‘æ§ï¼š
SELECT COUNT(*) FROM information_schema.PROCESSLIST;

åŒæ­¥å»¶è¿Ÿç›‘æ§ï¼š
SHOW SLAVE STATUS\G
-- å…³æ³¨ï¼šSeconds_Behind_Master

é›†ç¾¤çŠ¶æ€ç›‘æ§ï¼š
mysqlsh> cluster.status()
-- å…³æ³¨ï¼šmemberState, memberRole
```

---

## 3. ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†


### 3.1 å…¼å®¹æ€§åŸºæœ¬æ¦‚å¿µ


**ğŸ’­ é€šä¿—ç†è§£**ï¼š
ç‰ˆæœ¬å…¼å®¹æ€§å°±åƒä¸åŒå¹´ä»£çš„æ‰‹æœºå……ç”µå™¨ã€‚æœ‰äº›æ–°å……ç”µå™¨å¯ä»¥ç»™è€æ‰‹æœºå……ç”µï¼ˆå‘ä¸‹å…¼å®¹ï¼‰ï¼Œæœ‰äº›è€å……ç”µå™¨ä¸èƒ½ç»™æ–°æ‰‹æœºå……ç”µï¼ˆå‘ä¸Šä¸å…¼å®¹ï¼‰ã€‚

**ğŸ”¸ å…¼å®¹æ€§ç±»å‹**
```
å‘ä¸‹å…¼å®¹ï¼ˆBackward Compatibilityï¼‰ï¼š
æ–°ç‰ˆæœ¬èƒ½å¤„ç†æ—§ç‰ˆæœ¬çš„æ•°æ®å’Œé…ç½®
ç¤ºä¾‹ï¼šMySQL 8.0.36å¯ä»¥è¯»å–8.0.35çš„æ•°æ®æ–‡ä»¶

å‘ä¸Šå…¼å®¹ï¼ˆForward Compatibilityï¼‰ï¼š  
æ—§ç‰ˆæœ¬èƒ½å¤„ç†æ–°ç‰ˆæœ¬çš„æ•°æ®ï¼ˆé€šå¸¸ä¸æ”¯æŒï¼‰
ç¤ºä¾‹ï¼šMySQL 8.0.35é€šå¸¸æ— æ³•å¤„ç†8.0.36çš„æ–°ç‰¹æ€§æ•°æ®

æ¨ªå‘å…¼å®¹ï¼ˆLateral Compatibilityï¼‰ï¼š
åŒä¸€ç‰ˆæœ¬ä¸åŒèŠ‚ç‚¹é—´çš„å…¼å®¹æ€§
ç¤ºä¾‹ï¼š8.0.35å’Œ8.0.36æ··åˆè¿è¡Œçš„å…¼å®¹æ€§
```

### 3.2 ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥


**ğŸ” å…¼å®¹æ€§æ£€æŸ¥æ¸…å•**

| æ£€æŸ¥é¡¹ç›® | **æ£€æŸ¥æ–¹æ³•** | **é‡è¦ç¨‹åº¦** |
|---------|-------------|-------------|
| ğŸ”§ **MySQLç‰ˆæœ¬** | `SELECT VERSION()` | â­â­â­ |
| ğŸ“Š **æ•°æ®å­—å…¸ç‰ˆæœ¬** | `SELECT $$global.mysql_server_uuid` | â­â­â­ |
| âš™ï¸ **é…ç½®å‚æ•°** | `SHOW VARIABLES` | â­â­ |
| ğŸ“š **å­˜å‚¨å¼•æ“** | `SHOW ENGINES` | â­â­â­ |
| ğŸ”Œ **æ’ä»¶ç‰ˆæœ¬** | `SHOW PLUGINS` | â­â­ |

### 3.3 æ··åˆç‰ˆæœ¬è¿è¡Œç­–ç•¥


**âš¡ ä¸´æ—¶æ··åˆè¿è¡ŒåŸåˆ™**
```
æœ€å¤§ç‰ˆæœ¬å·®å¼‚é™åˆ¶ï¼š
â€¢ ç›¸é‚»å°ç‰ˆæœ¬ï¼šé€šå¸¸æ”¯æŒï¼ˆå¦‚8.0.35å’Œ8.0.36ï¼‰
â€¢ è·¨ä¸­ç‰ˆæœ¬ï¼šéœ€è¦æµ‹è¯•éªŒè¯
â€¢ è·¨å¤§ç‰ˆæœ¬ï¼šä¸å»ºè®®æ··åˆè¿è¡Œ

è¿è¡Œæ—¶é—´é™åˆ¶ï¼š
â€¢ æ··åˆç‰ˆæœ¬è¿è¡Œåº”å°½å¯èƒ½çŸ­æš‚
â€¢ å»ºè®®æ§åˆ¶åœ¨ç»´æŠ¤çª—å£å†…ï¼ˆ1-4å°æ—¶ï¼‰
â€¢ é¿å…é•¿æœŸæ··åˆç‰ˆæœ¬è¿è¡Œ
```

**ğŸ”§ å…¼å®¹æ€§éªŒè¯è„šæœ¬**
```sql
-- æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
SELECT 
    $$hostname as node_name,
    $$version as mysql_version,
    $$version_compile_machine as architecture,
    $$innodb_version as innodb_version;

-- æ£€æŸ¥å…³é”®é…ç½®å‚æ•°
SHOW VARIABLES WHERE Variable_name IN (
    'innodb_file_format',
    'sql_mode',
    'lower_case_table_names'
);
```

---

## 4. âš ï¸ å‡çº§é£é™©è¯„ä¼°


### 4.1 é£é™©è¯„ä¼°æ¡†æ¶


**ğŸ¯ é£é™©è¯„ä¼°å°±æ˜¯ä»€ä¹ˆï¼Ÿ**
å°±åƒåŒ»ç”Ÿåœ¨æ‰‹æœ¯å‰è¦è¯„ä¼°é£é™©ä¸€æ ·ï¼Œæ•°æ®åº“å‡çº§å‰ä¹Ÿè¦è¯„ä¼°å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œæå‰å‡†å¤‡åº”å¯¹æ–¹æ¡ˆã€‚

**ğŸ“Š é£é™©è¯„ä¼°çŸ©é˜µ**

| é£é™©ç±»å‹ | **å‘ç”Ÿæ¦‚ç‡** | **å½±å“ç¨‹åº¦** | **é£é™©ç­‰çº§** | **åº”å¯¹ç­–ç•¥** |
|---------|-------------|-------------|-------------|-------------|
| ğŸ”§ **é…ç½®ä¸å…¼å®¹** | ä¸­ | ä¸­ | ğŸŸ¡ ä¸­é£é™© | é¢„å…ˆæµ‹è¯•éªŒè¯ |
| ğŸ“Š **æ•°æ®æŸå** | ä½ | é«˜ | ğŸ”´ é«˜é£é™© | å®Œæ•´å¤‡ä»½+å›æ»šè®¡åˆ’ |
| â° **æ€§èƒ½ä¸‹é™** | ä¸­ | ä¸­ | ğŸŸ¡ ä¸­é£é™© | æ€§èƒ½åŸºçº¿å¯¹æ¯” |
| ğŸ”Œ **åº”ç”¨å…¼å®¹æ€§** | é«˜ | é«˜ | ğŸ”´ é«˜é£é™© | åº”ç”¨æµ‹è¯•+ç°åº¦å‘å¸ƒ |
| ğŸŒ **ç½‘ç»œé—®é¢˜** | ä½ | ä¸­ | ğŸŸ¢ ä½é£é™© | ç½‘ç»œç›‘æ§ |

### 4.2 é£é™©è¯†åˆ«æ–¹æ³•


**ğŸ” æŠ€æœ¯é£é™©è¯†åˆ«**
```sql
-- 1. æ£€æŸ¥åºŸå¼ƒç‰¹æ€§ä½¿ç”¨æƒ…å†µ
SELECT table_schema, table_name, engine 
FROM information_schema.tables 
WHERE engine IN ('MyISAM', 'MEMORY') -- å¯èƒ½åºŸå¼ƒçš„å¼•æ“

-- 2. æ£€æŸ¥SQLæ¨¡å¼å…¼å®¹æ€§
SELECT $$sql_mode;

-- 3. æ£€æŸ¥å­—ç¬¦é›†å…¼å®¹æ€§  
SELECT DISTINCT character_set_name 
FROM information_schema.columns 
WHERE character_set_name IS NOT NULL;
```

**ğŸ“‹ ä¸šåŠ¡é£é™©è¯†åˆ«**
```
é«˜å³°æœŸå½±å“è¯„ä¼°ï¼š
â€¢ å‡çº§æ—¶é—´æ˜¯å¦é¿å¼€ä¸šåŠ¡é«˜å³°
â€¢ é¢„è®¡å‡çº§è€—æ—¶æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´
â€¢ å¤‡ç”¨æ–¹æ¡ˆæ˜¯å¦å……åˆ†

æ•°æ®é‡å½±å“è¯„ä¼°ï¼š
â€¢ å¤§è¡¨å‡çº§æ—¶é—´é¢„ä¼°
â€¢ ç´¢å¼•é‡å»ºæ—¶é—´è¯„ä¼°
â€¢ æ•°æ®è¿ç§»æ—¶é—´è®¡ç®—
```

### 4.3 é£é™©ç¼“è§£ç­–ç•¥


**ğŸ›¡ï¸ é¢„é˜²æ€§æªæ–½**
```
ğŸ”¸ æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼š
â€¢ å®Œå…¨å¤åˆ¶ç”Ÿäº§ç¯å¢ƒè¿›è¡Œå‡çº§æµ‹è¯•
â€¢ æ€§èƒ½åŸºå‡†æµ‹è¯•å¯¹æ¯”
â€¢ åº”ç”¨å…¼å®¹æ€§æµ‹è¯•

ğŸ”¸ åˆ†é˜¶æ®µå‡çº§ï¼š
â€¢ å…ˆå‡çº§æµ‹è¯•ç¯å¢ƒ
â€¢ å†å‡çº§é¢„ç”Ÿäº§ç¯å¢ƒ  
â€¢ æœ€åå‡çº§ç”Ÿäº§ç¯å¢ƒ

ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼š
â€¢ å®æ—¶ç›‘æ§é›†ç¾¤çŠ¶æ€
â€¢ è®¾ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦
â€¢ å‡†å¤‡åº”æ€¥å“åº”å›¢é˜Ÿ
```

---

## 5. ğŸ“‹ é…ç½®è¿ç§»ç­–ç•¥


### 5.1 é…ç½®è¿ç§»åŸºæœ¬æ¦‚å¿µ


**ğŸ’¡ ä»€ä¹ˆæ˜¯é…ç½®è¿ç§»ï¼Ÿ**
å°±åƒæ¬å®¶æ—¶è¦æŠŠæ—§æˆ¿å­çš„ä¸ªäººè®¾ç½®ï¼ˆæ¸©åº¦ã€å®¶å…·æ‘†æ”¾ï¼‰è¿ç§»åˆ°æ–°æˆ¿å­ä¸€æ ·ï¼ŒMySQLå‡çº§æ—¶ä¹Ÿè¦æŠŠæ—§ç‰ˆæœ¬çš„é…ç½®å‚æ•°è¿ç§»åˆ°æ–°ç‰ˆæœ¬ã€‚

**ğŸ”¸ é…ç½®ç±»å‹åˆ†ç±»**
```
ç³»ç»Ÿçº§é…ç½®ï¼š
â€¢ my.cnfé…ç½®æ–‡ä»¶å‚æ•°
â€¢ ç¯å¢ƒå˜é‡è®¾ç½®
â€¢ æœåŠ¡å¯åŠ¨å‚æ•°

æ•°æ®åº“çº§é…ç½®ï¼š
â€¢ å…¨å±€å˜é‡è®¾ç½®
â€¢ ç”¨æˆ·æƒé™é…ç½®
â€¢ æ’ä»¶é…ç½®

é›†ç¾¤çº§é…ç½®ï¼š
â€¢ ä¸»ä»å¤åˆ¶é…ç½®
â€¢ é›†ç¾¤é€šä¿¡é…ç½®
â€¢ æ•…éšœåˆ‡æ¢é…ç½®
```

### 5.2 é…ç½®å·®å¼‚åˆ†æ


**ğŸ” æ–°æ—§ç‰ˆæœ¬é…ç½®å¯¹æ¯”æ–¹æ³•**

**Step 1: å¯¼å‡ºå½“å‰é…ç½®** ğŸ“¤
```bash
# å¯¼å‡ºå½“å‰MySQLé…ç½®
mysqldump --single-transaction --routines --triggers \
  --all-databases > current_config.sql

# å¯¼å‡ºç³»ç»Ÿå˜é‡
mysql -e "SHOW GLOBAL VARIABLES" > current_variables.txt

# å¯¼å‡ºç”¨æˆ·æƒé™
mysql -e "SELECT * FROM mysql.user" > current_users.sql
```

**Step 2: é…ç½®å…¼å®¹æ€§æ£€æŸ¥** ğŸ”„
```sql
-- æ£€æŸ¥å¯èƒ½ä¸å…¼å®¹çš„å‚æ•°
SELECT variable_name, variable_value 
FROM performance_schema.global_variables 
WHERE variable_name IN (
    'sql_mode',                    -- SQLæ¨¡å¼å¯èƒ½æœ‰å˜åŒ–
    'lower_case_table_names',      -- å¤§å°å†™æ•æ„Ÿæ€§
    'default_authentication_plugin' -- è®¤è¯æ’ä»¶
);
```

**Step 3: ç”Ÿæˆè¿ç§»æ¸…å•** ğŸ“‹
```
éœ€è¦ä¿ç•™çš„é…ç½®ï¼š
âœ… innodb_buffer_pool_size
âœ… max_connections  
âœ… innodb_log_file_size
âœ… è‡ªå®šä¹‰ç”¨æˆ·å’Œæƒé™

éœ€è¦æ›´æ–°çš„é…ç½®ï¼š
ğŸ”„ sql_mode (å¯èƒ½æœ‰æ–°çš„æ¨¡å¼)
ğŸ”„ default_authentication_plugin
ğŸ”„ innodb_file_format (å¯èƒ½å·²åºŸå¼ƒ)

éœ€è¦æ–°å¢çš„é…ç½®ï¼š
â• æ–°ç‰ˆæœ¬çš„æ€§èƒ½ä¼˜åŒ–å‚æ•°
â• æ–°çš„å®‰å…¨é…ç½®é€‰é¡¹
```

### 5.3 è‡ªåŠ¨åŒ–é…ç½®è¿ç§»


**ğŸ”§ é…ç½®è¿ç§»è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# MySQLé…ç½®è¿ç§»è„šæœ¬

# 1. å¤‡ä»½å½“å‰é…ç½®
cp /etc/my.cnf /etc/my.cnf.backup.$(date +%Y%m%d)

# 2. ç”Ÿæˆæ–°é…ç½®æ–‡ä»¶
cat > /etc/my.cnf.new << EOF
[mysqld]
# åŸºç¡€é…ç½®ä¿ç•™
port = 3306
datadir = /var/lib/mysql

# æ€§èƒ½é…ç½®è¿ç§»
innodb_buffer_pool_size = $(grep innodb_buffer_pool_size /etc/my.cnf.backup* | cut -d'=' -f2)
max_connections = $(grep max_connections /etc/my.cnf.backup* | cut -d'=' -f2)

# æ–°ç‰ˆæœ¬æ¨èé…ç½®
default_authentication_plugin = mysql_native_password
innodb_redo_log_capacity = 512M
EOF

# 3. éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
mysqld --help --verbose > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®"
    mv /etc/my.cnf.new /etc/my.cnf
else
    echo "é…ç½®æ–‡ä»¶æœ‰é”™è¯¯ï¼Œè¯·æ£€æŸ¥"
    exit 1
fi
```

---

## 6. âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯


### 6.1 æ•°æ®å®Œæ•´æ€§æ£€æŸ¥åŸç†


**ğŸ¯ ä¸ºä»€ä¹ˆè¦æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼Ÿ**
å‡çº§è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å°±åƒåœ¨æ¬è¿è¿‡ç¨‹ä¸­çš„æ˜“ç¢å“ï¼Œéœ€è¦åœ¨æ¯ä¸ªç¯èŠ‚éƒ½æ£€æŸ¥æ˜¯å¦æœ‰æŸåï¼Œç¡®ä¿æ¬åˆ°æ–°åœ°æ–¹åå®Œå¥½æ— æŸã€‚

**ğŸ”¸ æ£€æŸ¥ç»´åº¦**
```
æ•°æ®ä¸€è‡´æ€§ï¼šå„èŠ‚ç‚¹é—´æ•°æ®æ˜¯å¦ç›¸åŒ
æ•°æ®å®Œæ•´æ€§ï¼šæ•°æ®æ˜¯å¦ä¸¢å¤±æˆ–æŸå  
ç´¢å¼•å®Œæ•´æ€§ï¼šç´¢å¼•æ˜¯å¦æ­£ç¡®æ„å»º
çº¦æŸå®Œæ•´æ€§ï¼šå¤–é”®ç­‰çº¦æŸæ˜¯å¦æœ‰æ•ˆ
```

### 6.2 å¤šå±‚æ¬¡éªŒè¯ç­–ç•¥


**ğŸ“Š éªŒè¯å±‚æ¬¡ç»“æ„**
```
Level 1: ç³»ç»Ÿçº§éªŒè¯ â† æ–‡ä»¶ç³»ç»Ÿã€è¡¨ç»“æ„
Level 2: æ•°æ®çº§éªŒè¯ â† è¡Œæ•°ã€æ ¡éªŒå’Œ
Level 3: ä¸šåŠ¡çº§éªŒè¯ â† å…³é”®ä¸šåŠ¡æ•°æ®
Level 4: åº”ç”¨çº§éªŒè¯ â† åº”ç”¨åŠŸèƒ½æµ‹è¯•
```

### 6.3 å…·ä½“éªŒè¯æ–¹æ³•


**ğŸ” ç³»ç»Ÿçº§éªŒè¯**
```sql
-- 1. æ£€æŸ¥è¡¨ç»“æ„å®Œæ•´æ€§
SELECT table_schema, table_name, 
       table_rows, data_length, index_length
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'sys');

-- 2. æ£€æŸ¥ç´¢å¼•å®Œæ•´æ€§
SELECT table_schema, table_name, index_name, 
       cardinality, index_type
FROM information_schema.statistics;

-- 3. æ£€æŸ¥è¡¨æŸå
CHECK TABLE your_important_table;
```

**ğŸ” æ•°æ®çº§éªŒè¯**
```sql
-- æ•°æ®è¡Œæ•°å¯¹æ¯”
SELECT 
    table_schema,
    table_name,
    table_rows as estimated_rows,
    (SELECT COUNT(*) FROM table_name) as actual_rows
FROM information_schema.tables;

-- æ•°æ®æ ¡éªŒå’Œå¯¹æ¯”
SELECT table_schema, table_name,
       CHECKSUM TABLE table_name;
```

**ğŸ” ä¸šåŠ¡çº§éªŒè¯è„šæœ¬**
```python
# PythonéªŒè¯è„šæœ¬ç¤ºä¾‹
import mysql.connector

def verify_business_data():
    """éªŒè¯å…³é”®ä¸šåŠ¡æ•°æ®"""
    
    # è¿æ¥æ•°æ®åº“
    conn = mysql.connector.connect(
        host='localhost',
        user='root',
        password='password',
        database='business_db'
    )
    
    cursor = conn.cursor()
    
    # éªŒè¯å…³é”®ä¸šåŠ¡æŒ‡æ ‡
    checks = [
        ("ç”¨æˆ·æ€»æ•°", "SELECT COUNT(*) FROM users"),
        ("è®¢å•æ€»æ•°", "SELECT COUNT(*) FROM orders"),
        ("ä»Šæ—¥é”€å”®é¢", "SELECT SUM(amount) FROM orders WHERE date = CURDATE()")
    ]
    
    for name, sql in checks:
        cursor.execute(sql)
        result = cursor.fetchone()[0]
        print(f"{name}: {result}")
        
    conn.close()

# æ‰§è¡ŒéªŒè¯
verify_business_data()
```

### 6.4 è‡ªåŠ¨åŒ–éªŒè¯æµç¨‹


**ğŸ”„ éªŒè¯æµç¨‹è‡ªåŠ¨åŒ–**
```bash
#!/bin/bash
# æ•°æ®å®Œæ•´æ€§è‡ªåŠ¨éªŒè¯è„šæœ¬

echo "å¼€å§‹æ•°æ®å®Œæ•´æ€§éªŒè¯..."

# 1. åŸºç¡€è¿æ¥æµ‹è¯•
mysql -e "SELECT 1" > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "âŒ æ•°æ®åº“è¿æ¥å¤±è´¥"
    exit 1
fi
echo "âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸"

# 2. è¡¨å®Œæ•´æ€§æ£€æŸ¥
mysql -e "
SELECT CONCAT('CHECK TABLE ', table_schema, '.', table_name, ';') 
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'sys')
" | mysql --batch --skip-column-names

# 3. æ•°æ®ä¸€è‡´æ€§éªŒè¯
echo "éªŒè¯é›†ç¾¤æ•°æ®ä¸€è‡´æ€§..."
# è¿™é‡Œæ·»åŠ é›†ç¾¤é—´æ•°æ®å¯¹æ¯”é€»è¾‘

echo "âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯å®Œæˆ"
```

---

## 7. ğŸ”™ å‡çº§å›æ»šæœºåˆ¶


### 7.1 å›æ»šåŸºæœ¬æ¦‚å¿µ


**ğŸ’­ å›æ»šæ˜¯ä»€ä¹ˆï¼Ÿ**
å›æ»šå°±åƒ"åæ‚”è¯"ï¼Œå½“å‡çº§å‡ºç°é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿè¿”å›åˆ°å‡çº§å‰çš„çŠ¶æ€ï¼Œå°±åƒæ—¶å…‰å€’æµä¸€æ ·è®©ç³»ç»Ÿå›åˆ°å®‰å…¨çš„çŠ¶æ€ã€‚

**ğŸ”¸ å›æ»šè§¦å‘æ¡ä»¶**
```
è‡ªåŠ¨å›æ»šè§¦å‘ï¼š
â€¢ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥å¤±è´¥
â€¢ åº”ç”¨è¿æ¥æµ‹è¯•å¤±è´¥  
â€¢ æ€§èƒ½æŒ‡æ ‡ä¸¥é‡ä¸‹é™
â€¢ é›†ç¾¤èŠ‚ç‚¹æ•…éšœè¶…è¿‡é˜ˆå€¼

æ‰‹åŠ¨å›æ»šè§¦å‘ï¼š
â€¢ ä¸šåŠ¡åŠŸèƒ½å¼‚å¸¸
â€¢ ç”¨æˆ·åé¦ˆé—®é¢˜æ¿€å¢
â€¢ è¿ç»´äººå‘˜ä¸»è§‚åˆ¤æ–­é£é™©è¿‡é«˜
```

### 7.2 å›æ»šç­–ç•¥è®¾è®¡


**ğŸ¯ å›æ»šç­–ç•¥åˆ†ç±»**

| å›æ»šç±»å‹ | **é€‚ç”¨åœºæ™¯** | **å›æ»šæ—¶é—´** | **æ•°æ®ä¸¢å¤±é£é™©** |
|---------|-------------|-------------|----------------|
| ğŸ”„ **é…ç½®å›æ»š** | é…ç½®å‚æ•°é—®é¢˜ | 5-10åˆ†é’Ÿ | æ—  |
| ğŸ“¦ **ç‰ˆæœ¬å›æ»š** | è½¯ä»¶ç‰ˆæœ¬é—®é¢˜ | 10-30åˆ†é’Ÿ | æä½ |
| ğŸ’¾ **æ•°æ®å›æ»š** | æ•°æ®æŸåé—®é¢˜ | 30åˆ†é’Ÿ-2å°æ—¶ | éƒ¨åˆ†å¯èƒ½ |
| ğŸŒ **å®Œæ•´å›æ»š** | ç³»ç»Ÿæ€§é—®é¢˜ | 1-4å°æ—¶ | éƒ¨åˆ†å¯èƒ½ |

### 7.3 å›æ»šå®æ–½æ­¥éª¤


**ğŸ”§ é…ç½®å›æ»šæ­¥éª¤**
```bash
# Step 1: åœæ­¢MySQLæœåŠ¡
systemctl stop mysql

# Step 2: æ¢å¤é…ç½®æ–‡ä»¶
cp /etc/my.cnf.backup /etc/my.cnf

# Step 3: é‡å¯æœåŠ¡
systemctl start mysql

# Step 4: éªŒè¯æœåŠ¡çŠ¶æ€
mysql -e "SELECT $$version, $$hostname"
```

**ğŸ”§ ç‰ˆæœ¬å›æ»šæ­¥éª¤**
```bash
# Step 1: å‡†å¤‡æ—§ç‰ˆæœ¬è½¯ä»¶åŒ…
# ç¡®ä¿æœ‰å®Œæ•´çš„æ—§ç‰ˆæœ¬å®‰è£…åŒ…

# Step 2: å¸è½½æ–°ç‰ˆæœ¬
yum remove mysql-server mysql-client

# Step 3: å®‰è£…æ—§ç‰ˆæœ¬  
yum install mysql-server-8.0.35 mysql-client-8.0.35

# Step 4: æ¢å¤æ•°æ®ç›®å½•
systemctl stop mysql
cp -r /backup/mysql-data/* /var/lib/mysql/
chown -R mysql:mysql /var/lib/mysql

# Step 5: å¯åŠ¨éªŒè¯
systemctl start mysql
```

### 7.4 å›æ»šå†³ç­–çŸ©é˜µ


**ğŸ“Š å›æ»šå†³ç­–æ ‡å‡†**
```
ç«‹å³å›æ»šåœºæ™¯ï¼š
ğŸš¨ æ•°æ®æŸåæˆ–ä¸¢å¤±
ğŸš¨ æœåŠ¡å®Œå…¨ä¸å¯ç”¨
ğŸš¨ å®‰å…¨æ¼æ´è¢«åˆ©ç”¨
ğŸš¨ æ€§èƒ½ä¸‹é™è¶…è¿‡50%

è€ƒè™‘å›æ»šåœºæ™¯ï¼š
âš ï¸ éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸
âš ï¸ æ€§èƒ½ä¸‹é™20-50%
âš ï¸ ç”¨æˆ·æŠ•è¯‰å¢åŠ 
âš ï¸ ç›‘æ§å‘Šè­¦é¢‘ç¹

æš‚ä¸å›æ»šåœºæ™¯ï¼š
âœ… è½»å¾®æ€§èƒ½æ³¢åŠ¨
âœ… ä¸ªåˆ«ç”¨æˆ·é—®é¢˜
âœ… å¯é€šè¿‡é…ç½®è°ƒä¼˜è§£å†³
âœ… é—®é¢˜å½±å“èŒƒå›´æœ‰é™
```

---

## 8. â° ç»´æŠ¤çª—å£ç®¡ç†


### 8.1 ç»´æŠ¤çª—å£åŸºæœ¬æ¦‚å¿µ


**ğŸ• ä»€ä¹ˆæ˜¯ç»´æŠ¤çª—å£ï¼Ÿ**
ç»´æŠ¤çª—å£å°±åƒåŒ»é™¢çš„æ‰‹æœ¯æ—¶é—´å®‰æ’ï¼Œé€‰æ‹©å¯¹ç—…äººå½±å“æœ€å°çš„æ—¶é—´æ®µè¿›è¡Œæ‰‹æœ¯ã€‚å¯¹æ•°æ®åº“æ¥è¯´ï¼Œå°±æ˜¯é€‰æ‹©å¯¹ä¸šåŠ¡å½±å“æœ€å°çš„æ—¶é—´è¿›è¡Œå‡çº§ç»´æŠ¤ã€‚

**ğŸ”¸ ç»´æŠ¤çª—å£ç‰¹å¾**
```
æ—¶é—´ç‰¹å¾ï¼š
â€¢ ä¸šåŠ¡ä½å³°æœŸï¼šç”¨æˆ·è®¿é—®é‡æœ€å°‘çš„æ—¶é—´æ®µ
â€¢ å¯é¢„æµ‹æ€§ï¼šæå‰å…¬å‘Šï¼Œè®©ç”¨æˆ·å’Œä¸šåŠ¡æ–¹çŸ¥æ™“
â€¢ å¯æ§æ€§ï¼šæœ‰æ˜ç¡®çš„å¼€å§‹å’Œç»“æŸæ—¶é—´

å½±å“ç‰¹å¾ï¼š
â€¢ æœ€å°åŒ–ä¸šåŠ¡ä¸­æ–­
â€¢ æœ€å°åŒ–ç”¨æˆ·ä½“éªŒå½±å“
â€¢ æœ€å°åŒ–æ•°æ®ä¸¢å¤±é£é™©
```

### 8.2 ç»´æŠ¤çª—å£è§„åˆ’


**ğŸ“… æ—¶é—´çª—å£é€‰æ‹©ç­–ç•¥**

| ä¸šåŠ¡ç±»å‹ | **æ¨èç»´æŠ¤çª—å£** | **æŒç»­æ—¶é—´** | **é¢‘ç‡** |
|---------|----------------|-------------|----------|
| ğŸ¢ **ä¼ä¸šåº”ç”¨** | å‘¨æœ«å‡Œæ™¨2-6ç‚¹ | 2-4å°æ—¶ | æœˆåº¦ |
| ğŸ›’ **ç”µå•†å¹³å°** | å·¥ä½œæ—¥å‡Œæ™¨3-5ç‚¹ | 1-2å°æ—¶ | åŒå‘¨ |
| ğŸ® **æ¸¸æˆå¹³å°** | å‘¨äºŒä¸Šåˆç»´æŠ¤ | 2-3å°æ—¶ | å‘¨åº¦ |
| ğŸŒ **å…¨çƒä¸šåŠ¡** | åˆ†åŒºåŸŸè½®æ¢ | 1-2å°æ—¶/åŒºåŸŸ | çµæ´» |

**ğŸ”§ ç»´æŠ¤çª—å£è®¡ç®—æ–¹æ³•**
```python
# Pythonç»´æŠ¤çª—å£åˆ†æè„šæœ¬
import pandas as pd
from datetime import datetime, timedelta

def analyze_traffic_pattern():
    """åˆ†ææµé‡æ¨¡å¼ï¼Œç¡®å®šæœ€ä½³ç»´æŠ¤çª—å£"""
    
    # å‡è®¾æœ‰ä¸€å‘¨çš„å°æ—¶çº§è®¿é—®æ•°æ®
    traffic_data = {
        'hour': list(range(0, 24)) * 7,
        'day_of_week': [d for d in range(7) for _ in range(24)],
        'requests_per_hour': [...]  # å®é™…æµé‡æ•°æ®
    }
    
    df = pd.DataFrame(traffic_data)
    
    # è®¡ç®—æ¯å°æ—¶å¹³å‡æµé‡
    hourly_avg = df.groupby('hour')['requests_per_hour'].mean()
    
    # æ‰¾å‡ºæµé‡æœ€ä½çš„4å°æ—¶è¿ç»­çª—å£
    min_traffic_hours = hourly_avg.nsmallest(4).index.tolist()
    
    return min_traffic_hours

# ç¤ºä¾‹ç»“æœï¼š[2, 3, 4, 5] è¡¨ç¤ºå‡Œæ™¨2-6ç‚¹æµé‡æœ€ä½
```

### 8.3 ç»´æŠ¤çª—å£æ‰§è¡Œç®¡ç†


**ğŸ”„ ç»´æŠ¤çª—å£æ ‡å‡†æµç¨‹**

**Phase 1: å‡†å¤‡é˜¶æ®µ** (T-30åˆ†é’Ÿ)
```bash
# 1. å‘é€ç»´æŠ¤å¼€å§‹é€šçŸ¥
echo "æ•°æ®åº“ç»´æŠ¤å°†åœ¨30åˆ†é’Ÿåå¼€å§‹" | mail -s "ç»´æŠ¤é€šçŸ¥" ops-team@company.com

# 2. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
mysqlsh> cluster.status()

# 3. åˆ›å»ºæœ€åå¤‡ä»½
mysqldump --single-transaction --all-databases > final_backup_$(date +%Y%m%d_%H%M).sql
```

**Phase 2: æ‰§è¡Œé˜¶æ®µ** (T+0)
```bash
# 1. æ­£å¼å¼€å§‹ç»´æŠ¤
echo "ç»´æŠ¤å¼€å§‹æ—¶é—´: $(date)" >> maintenance.log

# 2. æ‰§è¡Œå‡çº§æ“ä½œ
# (å…·ä½“å‡çº§æ­¥éª¤)

# 3. å®æ—¶ç›‘æ§è¿›åº¦
tail -f maintenance.log
```

**Phase 3: éªŒè¯é˜¶æ®µ** (T+å‡çº§å®Œæˆ)
```bash
# 1. ç³»ç»ŸåŠŸèƒ½éªŒè¯
mysql -e "SELECT COUNT(*) FROM important_table"

# 2. æ€§èƒ½æµ‹è¯•
sysbench --test=oltp_read_write run

# 3. åº”ç”¨è¿æ¥æµ‹è¯•
curl -f http://app-server/health-check
```

**Phase 4: å®Œæˆé˜¶æ®µ**
```bash
# 1. å‘é€å®Œæˆé€šçŸ¥
echo "æ•°æ®åº“ç»´æŠ¤å·²å®Œæˆï¼ŒæœåŠ¡æ­£å¸¸" | mail -s "ç»´æŠ¤å®Œæˆ" ops-team@company.com

# 2. æ›´æ–°ç»´æŠ¤è®°å½•
echo "ç»´æŠ¤å®Œæˆæ—¶é—´: $(date)" >> maintenance.log
```

---

## 9. ğŸ“Š å˜æ›´å½±å“åˆ†æ


### 9.1 å½±å“åˆ†æåŸºæœ¬æ¦‚å¿µ


**ğŸ¯ ä»€ä¹ˆæ˜¯å˜æ›´å½±å“åˆ†æï¼Ÿ**
å°±åƒåŒ»ç”Ÿåœ¨å¼€è¯å‰è¦åˆ†æè¯ç‰©å‰¯ä½œç”¨ä¸€æ ·ï¼Œæ•°æ®åº“å‡çº§å‰è¦åˆ†æå¯èƒ½å¯¹ç³»ç»Ÿå’Œä¸šåŠ¡é€ æˆçš„å„ç§å½±å“ã€‚

**ğŸ”¸ å½±å“åˆ†æç»´åº¦**
```
æŠ€æœ¯å½±å“ï¼š
â€¢ æ€§èƒ½å½±å“ï¼šå“åº”æ—¶é—´ã€ååé‡å˜åŒ–
â€¢ åŠŸèƒ½å½±å“ï¼šæ–°ç‰¹æ€§ã€åºŸå¼ƒåŠŸèƒ½
â€¢ å…¼å®¹æ€§å½±å“ï¼šAPIã€åè®®å˜åŒ–

ä¸šåŠ¡å½±å“ï¼š  
â€¢ ç”¨æˆ·ä½“éªŒå½±å“ï¼šè®¿é—®é€Ÿåº¦ã€åŠŸèƒ½å¯ç”¨æ€§
â€¢ è¿è¥å½±å“ï¼šç›‘æ§ã€è¿ç»´æµç¨‹å˜åŒ–
â€¢ æˆæœ¬å½±å“ï¼šç¡¬ä»¶ã€äººåŠ›ã€æ—¶é—´æˆæœ¬
```

### 9.2 å½±å“è¯„ä¼°æ–¹æ³•


**ğŸ“Š å®šé‡å½±å“è¯„ä¼°**

| å½±å“æŒ‡æ ‡ | **å½“å‰åŸºçº¿** | **é¢„æœŸå˜åŒ–** | **å½±å“ç¨‹åº¦** |
|---------|-------------|-------------|-------------|
| ğŸš€ **æŸ¥è¯¢å“åº”æ—¶é—´** | 50ms | Â±10ms | ğŸŸ¡ ä¸­ç­‰ |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨ç‡** | 60% | +5% | ğŸŸ¢ è½»å¾® |
| ğŸ’¿ **ç£ç›˜I/O** | 1000 IOPS | +200 IOPS | ğŸŸ¡ ä¸­ç­‰ |
| ğŸŒ **å¹¶å‘è¿æ¥æ•°** | 500 | ä¸å˜ | ğŸŸ¢ æ— å½±å“ |
| â° **å‡çº§åœæœºæ—¶é—´** | æ—  | 2å°æ—¶ | ğŸ”´ é«˜å½±å“ |

**ğŸ” å®šæ€§å½±å“è¯„ä¼°**
```sql
-- åˆ†æSQLå…¼å®¹æ€§å½±å“
SELECT DISTINCT 
    sql_text,
    COUNT(*) as frequency
FROM performance_schema.events_statements_history_long 
WHERE sql_text LIKE '%æŸä¸ªå¯èƒ½ä¸å…¼å®¹çš„è¯­æ³•%'
GROUP BY sql_text
ORDER BY frequency DESC;

-- åˆ†ææ€§èƒ½å½±å“
SELECT 
    schema_name,
    digest_text,
    avg_timer_wait/1000000 as avg_ms,
    count_star as exec_count
FROM performance_schema.events_statements_summary_by_digest
ORDER BY avg_timer_wait DESC
LIMIT 20;
```

### 9.3 å½±å“é¢„æµ‹æ¨¡å‹


**ğŸ”® å½±å“é¢„æµ‹æ–¹æ³•**
```python
# Pythonå½±å“é¢„æµ‹æ¨¡å‹ç¤ºä¾‹
class UpgradeImpactPredictor:
    def __init__(self):
        self.baseline_metrics = {}
        self.prediction_model = {}
    
    def collect_baseline(self):
        """æ”¶é›†å½“å‰æ€§èƒ½åŸºçº¿"""
        self.baseline_metrics = {
            'avg_response_time': 50,  # ms
            'qps': 1000,              # æ¯ç§’æŸ¥è¯¢æ•°
            'cpu_usage': 60,          # CPUä½¿ç”¨ç‡%
            'memory_usage': 70        # å†…å­˜ä½¿ç”¨ç‡%
        }
    
    def predict_impact(self, upgrade_type):
        """é¢„æµ‹å‡çº§å½±å“"""
        impact_factors = {
            'minor_upgrade': {
                'response_time_factor': 1.05,  # å“åº”æ—¶é—´å¢åŠ 5%
                'resource_factor': 1.02       # èµ„æºä½¿ç”¨å¢åŠ 2%
            },
            'major_upgrade': {
                'response_time_factor': 1.15,  # å“åº”æ—¶é—´å¢åŠ 15%
                'resource_factor': 1.10       # èµ„æºä½¿ç”¨å¢åŠ 10%
            }
        }
        
        factor = impact_factors.get(upgrade_type, {})
        
        predicted_metrics = {
            'response_time': self.baseline_metrics['avg_response_time'] * 
                           factor.get('response_time_factor', 1.0),
            'cpu_usage': self.baseline_metrics['cpu_usage'] * 
                        factor.get('resource_factor', 1.0)
        }
        
        return predicted_metrics

# ä½¿ç”¨ç¤ºä¾‹
predictor = UpgradeImpactPredictor()
predictor.collect_baseline()
impact = predictor.predict_impact('minor_upgrade')
print(f"é¢„æµ‹å‡çº§åå“åº”æ—¶é—´: {impact['response_time']:.1f}ms")
```

---

## 10. ğŸš€ é›¶åœæœºå‡çº§å®ç°åŸç†


### 10.1 é›¶åœæœºå‡çº§æ ¸å¿ƒæ¦‚å¿µ


**ğŸ’¡ é›¶åœæœºå‡çº§æ˜¯ä»€ä¹ˆï¼Ÿ**
å°±åƒåœ¨é«˜é€Ÿè¡Œé©¶çš„ç«è½¦ä¸Šæ›´æ¢è½¦è½®ï¼Œè¦ä¿è¯ä¹˜å®¢æ„Ÿè§‰ä¸åˆ°ä»»ä½•é¢ ç°¸ï¼Œç«è½¦æŒç»­å¹³ç¨³è¿è¡Œã€‚æ•°æ®åº“é›¶åœæœºå‡çº§å°±æ˜¯åœ¨ä¸ä¸­æ–­ä¸šåŠ¡çš„æƒ…å†µä¸‹å®Œæˆç‰ˆæœ¬å‡çº§ã€‚

**ğŸ”¸ é›¶åœæœºçš„æŠ€æœ¯è¦æ±‚**
```
æœåŠ¡è¿ç»­æ€§ï¼š
â€¢ ç”¨æˆ·è¯·æ±‚å§‹ç»ˆèƒ½å¤Ÿå¾—åˆ°å“åº”
â€¢ æ•°æ®è¯»å†™æ“ä½œä¸ä¸­æ–­
â€¢ äº‹åŠ¡å¤„ç†ä¿æŒä¸€è‡´æ€§

æ•°æ®ä¸€è‡´æ€§ï¼š
â€¢ å‡çº§è¿‡ç¨‹ä¸­æ•°æ®ä¸ä¸¢å¤±
â€¢ å„èŠ‚ç‚¹æ•°æ®ä¿æŒåŒæ­¥
â€¢ äº‹åŠ¡ACIDç‰¹æ€§ä¸å—å½±å“

é€æ˜æ€§ï¼š
â€¢ ç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°å‡çº§è¿‡ç¨‹
â€¢ åº”ç”¨ç¨‹åºæ— éœ€ä¿®æ”¹
â€¢ è¿æ¥æ± å¯ä»¥æ­£å¸¸å·¥ä½œ
```

### 10.2 é›¶åœæœºå‡çº§æŠ€æœ¯æ¶æ„


**ğŸ—ï¸ æŠ€æœ¯å®ç°æ¶æ„**
```
           åº”ç”¨å±‚ (æ— æ„ŸçŸ¥)
              â†“
         è¿æ¥ä»£ç†/è´Ÿè½½å‡è¡¡
        â†™        â†“        â†˜
   èŠ‚ç‚¹A      èŠ‚ç‚¹B      èŠ‚ç‚¹C
   (å‡çº§)    (æœåŠ¡ä¸­)   (å¾…å‡çº§)
      â†“        â†“        â†“
   å…±äº«å­˜å‚¨/å¤åˆ¶åŒæ­¥æœºåˆ¶
```

**ğŸ”§ å…³é”®æŠ€æœ¯ç»„ä»¶**
```
ğŸ”¸ è¿æ¥ä»£ç† (ProxySQL/MySQL Router)ï¼š
â€¢ æ™ºèƒ½è·¯ç”±ï¼šå°†è¯·æ±‚è·¯ç”±åˆ°å¯ç”¨èŠ‚ç‚¹
â€¢ è¿æ¥æ± ç®¡ç†ï¼šç»´æŠ¤ä¸åç«¯æ•°æ®åº“çš„è¿æ¥
â€¢ æ•…éšœæ£€æµ‹ï¼šè‡ªåŠ¨æ£€æµ‹èŠ‚ç‚¹çŠ¶æ€å˜åŒ–

ğŸ”¸ æ•°æ®åŒæ­¥æœºåˆ¶ï¼š
â€¢ Group Replicationï¼šç¡®ä¿æ•°æ®å®æ—¶åŒæ­¥
â€¢ äºŒè¿›åˆ¶æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰æ•°æ®å˜æ›´
â€¢ GTIDï¼šå…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦ä¿è¯ä¸€è‡´æ€§

ğŸ”¸ çŠ¶æ€ç®¡ç†ï¼š
â€¢ å…ƒæ•°æ®å­˜å‚¨ï¼šè®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„å‡çº§çŠ¶æ€
â€¢ å¥åº·æ£€æŸ¥ï¼šå®æ—¶ç›‘æ§èŠ‚ç‚¹å¯ç”¨æ€§
â€¢ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå¼‚å¸¸æ—¶è‡ªåŠ¨åˆ‡æ¢
```

### 10.3 é›¶åœæœºå‡çº§æµç¨‹


**ğŸ”„ è¯¦ç»†å®æ–½æµç¨‹**

**Step 1: ç¯å¢ƒå‡†å¤‡** ğŸ› ï¸
```bash
# 1. éƒ¨ç½²è¿æ¥ä»£ç†
# é…ç½®ProxySQLæˆ–MySQL Router
# ç¡®ä¿æ‰€æœ‰åº”ç”¨è¿æ¥é€šè¿‡ä»£ç†

# 2. éªŒè¯æ•°æ®åŒæ­¥
mysqlsh> cluster.status()
# ç¡®è®¤æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸ºONLINEï¼ŒåŒæ­¥æ­£å¸¸

# 3. è®¾ç½®å‡çº§æ ‡è®°
mysql -e "SET GLOBAL upgrade_in_progress = 1"
```

**Step 2: æ»šåŠ¨å‡çº§æ‰§è¡Œ** ğŸ”„
```javascript
// ä¼ªä»£ç ï¼šé›¶åœæœºæ»šåŠ¨å‡çº§
function zeroDowntimeUpgrade() {
    let nodes = cluster.getSecondaryNodes()
    
    for (let node of nodes) {
        // 1. å°†èŠ‚ç‚¹æ ‡è®°ä¸ºç»´æŠ¤çŠ¶æ€
        proxy.markNodeMaintenance(node)
        
        // 2. ç­‰å¾…ç°æœ‰è¿æ¥ä¼˜é›…å…³é—­
        proxy.waitForDrainConnections(node, timeout=300)
        
        // 3. å‡çº§èŠ‚ç‚¹
        upgradeNode(node)
        
        // 4. éªŒè¯èŠ‚ç‚¹çŠ¶æ€
        if (verifyNodeHealth(node)) {
            proxy.markNodeOnline(node)
        } else {
            rollbackNode(node)
            throw new Error("å‡çº§å¤±è´¥ï¼Œå·²å›æ»š")
        }
        
        // 5. ç­‰å¾…æ•°æ®åŒæ­¥å®Œæˆ
        waitForDataSync(node)
    }
    
    // æœ€åå¤„ç†PrimaryèŠ‚ç‚¹
    upgradePrimaryNode()
}
```

**Step 3: è¿æ¥è¿ç§»ç®¡ç†** ğŸ”€
```sql
-- è¿æ¥è¿ç§»ç­–ç•¥
-- 1. æ–°è¿æ¥è·¯ç”±åˆ°å·²å‡çº§èŠ‚ç‚¹
UPDATE proxy_config 
SET backend_servers = 'upgraded_nodes_only'
WHERE rule_type = 'new_connections';

-- 2. ç°æœ‰è¿æ¥é€æ­¥è¿ç§»
-- é€šè¿‡è¿æ¥è¶…æ—¶è‡ªç„¶è¿ç§»
-- æˆ–å¼ºåˆ¶è¿ç§»éå…³é”®è¿æ¥
```

### 10.4 é›¶åœæœºå‡çº§ç›‘æ§


**ğŸ“Š å®æ—¶ç›‘æ§æŒ‡æ ‡**
```python
# é›¶åœæœºå‡çº§ç›‘æ§è„šæœ¬
import time
import mysql.connector

class ZeroDowntimeMonitor:
    def __init__(self):
        self.metrics = {}
    
    def monitor_upgrade_progress(self):
        """ç›‘æ§å‡çº§è¿›åº¦å’ŒæœåŠ¡å¯ç”¨æ€§"""
        
        while True:
            # 1. æ£€æŸ¥æœåŠ¡å¯ç”¨æ€§
            availability = self.check_service_availability()
            
            # 2. æ£€æŸ¥å“åº”æ—¶é—´
            response_time = self.measure_response_time()
            
            # 3. æ£€æŸ¥é”™è¯¯ç‡
            error_rate = self.calculate_error_rate()
            
            # 4. è¾“å‡ºç›‘æ§ç»“æœ
            print(f"å¯ç”¨æ€§: {availability:.2%}")
            print(f"å“åº”æ—¶é—´: {response_time:.1f}ms")
            print(f"é”™è¯¯ç‡: {error_rate:.2%}")
            
            # 5. å¦‚æœæŒ‡æ ‡å¼‚å¸¸ï¼Œè§¦å‘å‘Šè­¦
            if availability < 0.99 or error_rate > 0.01:
                self.trigger_alert("é›¶åœæœºå‡çº§å¼‚å¸¸")
            
            time.sleep(10)  # æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
    
    def check_service_availability(self):
        """æ£€æŸ¥æœåŠ¡å¯ç”¨æ€§"""
        try:
            conn = mysql.connector.connect(
                host='proxy-host',
                user='monitor_user',
                password='password'
            )
            cursor = conn.cursor()
            cursor.execute("SELECT 1")
            result = cursor.fetchone()
            conn.close()
            return 1.0 if result else 0.0
        except:
            return 0.0
```

---

## 11. ğŸ“¦ å¤§ç‰ˆæœ¬å‡çº§æ•°æ®è¿ç§»


### 11.1 å¤§ç‰ˆæœ¬å‡çº§æŒ‘æˆ˜


**ğŸ¯ å¤§ç‰ˆæœ¬å‡çº§çš„ç‰¹æ®Šæ€§**
å¤§ç‰ˆæœ¬å‡çº§å°±åƒä»æ—§æˆ¿å­æ¬åˆ°æ–°æˆ¿å­ï¼Œä¸ä»…è¦æ¬ä¸œè¥¿ï¼Œè¿˜å¯èƒ½éœ€è¦é‡æ–°è£…ä¿®é€‚åº”æ–°æˆ¿å­çš„æ ¼å±€ã€‚MySQLå¤§ç‰ˆæœ¬å‡çº§é¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜ï¼š

**ğŸ”¸ ä¸»è¦æŒ‘æˆ˜åˆ†æ**
```
æ•°æ®æ ¼å¼å˜åŒ–ï¼š
â€¢ å­˜å‚¨å¼•æ“æ ¼å¼å‡çº§ï¼šInnoDBæ–‡ä»¶æ ¼å¼å˜åŒ–
â€¢ ç´¢å¼•ç»“æ„è°ƒæ•´ï¼šæ–°çš„ç´¢å¼•ç±»å‹å’Œå­˜å‚¨æ–¹å¼
â€¢ å…ƒæ•°æ®ç»“æ„æ”¹å˜ï¼šç³»ç»Ÿè¡¨ç»“æ„å˜åŒ–

åŠŸèƒ½å…¼å®¹æ€§ï¼š
â€¢ åºŸå¼ƒç‰¹æ€§ç§»é™¤ï¼šæ—§ç‰ˆæœ¬åŠŸèƒ½ä¸å†æ”¯æŒ
â€¢ SQLè¯­æ³•å˜åŒ–ï¼šæŸäº›è¯­æ³•ä¸å†å…¼å®¹
â€¢ é»˜è®¤è¡Œä¸ºæ”¹å˜ï¼šå‚æ•°é»˜è®¤å€¼å˜åŒ–

æ€§èƒ½ç‰¹å¾å˜åŒ–ï¼š
â€¢ æŸ¥è¯¢ä¼˜åŒ–å™¨æ”¹è¿›ï¼šæ‰§è¡Œè®¡åˆ’å¯èƒ½å˜åŒ–
â€¢ æ–°çš„æ€§èƒ½ç‰¹æ€§ï¼šéœ€è¦é‡æ–°è°ƒä¼˜
â€¢ èµ„æºä½¿ç”¨æ¨¡å¼ï¼šå†…å­˜ã€CPUä½¿ç”¨æ–¹å¼å˜åŒ–
```

### 11.2 æ•°æ®è¿ç§»ç­–ç•¥é€‰æ‹©


**ğŸ“Š è¿ç§»ç­–ç•¥å¯¹æ¯”**

| ç­–ç•¥ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **åœæœºæ—¶é—´** | **æ•°æ®å®‰å…¨æ€§** | **å®æ–½å¤æ‚åº¦** |
|---------|-------------|-------------|---------------|---------------|
| ğŸ”„ **åŸåœ°å‡çº§** | å°æ•°æ®é‡ | çŸ­ | ä¸­ | ä½ |
| ğŸ“¤ **å¯¼å‡ºå¯¼å…¥** | ä¸­ç­‰æ•°æ®é‡ | é•¿ | é«˜ | ä¸­ |
| ğŸ”€ **é€»è¾‘å¤åˆ¶** | å¤§æ•°æ®é‡ | æçŸ­ | é«˜ | é«˜ |
| ğŸ’¾ **ç‰©ç†æ‹·è´** | è¶…å¤§æ•°æ®é‡ | ä¸­ | ä¸­ | ä¸­ |

### 11.3 é€»è¾‘å¤åˆ¶è¿ç§»å®ç°


**ğŸ”§ é€»è¾‘å¤åˆ¶è¿ç§»æ˜¯æœ€å¤æ‚ä½†æœ€å®‰å…¨çš„æ–¹æ¡ˆ**

**Step 1: ç¯å¢ƒå‡†å¤‡** ğŸ› ï¸
```bash
# 1. å‡†å¤‡æ–°ç‰ˆæœ¬MySQLç¯å¢ƒ
# å®‰è£…MySQL 9.0ï¼ˆç›®æ ‡ç‰ˆæœ¬ï¼‰
yum install mysql-server-9.0

# 2. é…ç½®æ–°ç¯å¢ƒåŸºæœ¬å‚æ•°
cat > /etc/my.cnf.new << EOF
[mysqld]
port = 3307                    # ä½¿ç”¨ä¸åŒç«¯å£é¿å…å†²çª
datadir = /var/lib/mysql-new
server-id = 200               # ä¸åŒçš„server-id
log-bin = mysql-bin-new
gtid-mode = ON
enforce-gtid-consistency = ON
EOF

# 3. åˆå§‹åŒ–æ–°æ•°æ®åº“
mysqld --defaults-file=/etc/my.cnf.new --initialize-insecure
```

**Step 2: æ•°æ®åˆå§‹åŒæ­¥** ğŸ“‹
```bash
# 1. åˆ›å»ºä¸€è‡´æ€§å¤‡ä»½
mysqldump --single-transaction --master-data=2 \
  --set-gtid-purged=ON --all-databases > full_backup.sql

# 2. æ¢å¤åˆ°æ–°ç¯å¢ƒ
mysql --defaults-file=/etc/my.cnf.new < full_backup.sql

# 3. é…ç½®å¤åˆ¶å…³ç³»
mysql --defaults-file=/etc/my.cnf.new -e "
CHANGE MASTER TO 
  MASTER_HOST='old-mysql-host',
  MASTER_PORT=3306,
  MASTER_USER='repl_user',
  MASTER_PASSWORD='repl_password',
  MASTER_AUTO_POSITION=1;
START SLAVE;
"
```

**Step 3: å®æ—¶åŒæ­¥éªŒè¯** âœ…
```sql
-- åœ¨æ–°ç¯å¢ƒä¸­æ£€æŸ¥åŒæ­¥çŠ¶æ€
SHOW SLAVE STATUS\G

-- å…³é”®æŒ‡æ ‡æ£€æŸ¥ï¼š
-- Slave_IO_Running: Yes
-- Slave_SQL_Running: Yes  
-- Seconds_Behind_Master: 0
-- Auto_Position: 1

-- æ•°æ®ä¸€è‡´æ€§éªŒè¯
SELECT COUNT(*) FROM important_table;  -- å¯¹æ¯”è¡Œæ•°
CHECKSUM TABLE important_table;        -- å¯¹æ¯”æ ¡éªŒå’Œ
```

### 11.4 åˆ‡æ¢æµç¨‹ç®¡ç†


**ğŸ”„ ç”Ÿäº§åˆ‡æ¢æµç¨‹**

**åˆ‡æ¢å‡†å¤‡é˜¶æ®µ** (T-1å°æ—¶)
```bash
# 1. æœ€ç»ˆæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
./verify_data_consistency.sh

# 2. åº”ç”¨è¿æ¥æµ‹è¯•
./test_app_connectivity.sh new-mysql-host:3307

# 3. æ€§èƒ½åŸºå‡†æµ‹è¯•
sysbench --mysql-host=new-mysql-host --mysql-port=3307 \
  --test=oltp_read_write --mysql-table-engine=innodb run
```

**æ­£å¼åˆ‡æ¢é˜¶æ®µ** (T=0)
```bash
# 1. è®¾ç½®æ—§åº“ä¸ºåªè¯»
mysql -e "SET GLOBAL read_only = 1"

# 2. ç­‰å¾…æœ€åçš„æ•°æ®åŒæ­¥
# ç¡®ä¿Seconds_Behind_Master = 0

# 3. åœæ­¢å¤åˆ¶
mysql --defaults-file=/etc/my.cnf.new -e "STOP SLAVE"

# 4. åˆ‡æ¢åº”ç”¨è¿æ¥
# ä¿®æ”¹åº”ç”¨é…ç½®æˆ–é€šè¿‡è´Ÿè½½å‡è¡¡å™¨åˆ‡æ¢

# 5. éªŒè¯æ–°ç¯å¢ƒæœåŠ¡æ­£å¸¸
./verify_new_environment.sh
```

**åˆ‡æ¢åéªŒè¯** (T+30åˆ†é’Ÿ)
```python
# Pythonåˆ‡æ¢éªŒè¯è„šæœ¬
def verify_migration_success():
    """éªŒè¯è¿ç§»æˆåŠŸ"""
    
    checks = [
        ("æ•°æ®åº“è¿æ¥", test_db_connection),
        ("å…³é”®è¡¨è¡Œæ•°", verify_table_counts),
        ("åº”ç”¨åŠŸèƒ½", test_app_functions),
        ("æ€§èƒ½æŒ‡æ ‡", check_performance_metrics)
    ]
    
    results = {}
    for name, test_func in checks:
        try:
            result = test_func()
            results[name] = "âœ… é€šè¿‡" if result else "âŒ å¤±è´¥"
        except Exception as e:
            results[name] = f"âŒ é”™è¯¯: {str(e)}"
    
    # ç”ŸæˆéªŒè¯æŠ¥å‘Š
    print("=== è¿ç§»éªŒè¯æŠ¥å‘Š ===")
    for name, result in results.items():
        print(f"{name}: {result}")
    
    return all("âœ…" in result for result in results.values())
```

---

## 12. ğŸ¤– å‡çº§è‡ªåŠ¨åŒ–ç¼–æ’


### 12.1 è‡ªåŠ¨åŒ–ç¼–æ’åŸºæœ¬æ¦‚å¿µ


**ğŸ’¡ ä»€ä¹ˆæ˜¯å‡çº§è‡ªåŠ¨åŒ–ç¼–æ’ï¼Ÿ**
å°±åƒäº¤å“ä¹å›¢çš„æŒ‡æŒ¥ï¼Œåè°ƒå„ä¸ªä¹æ‰‹ï¼ˆæœåŠ¡å™¨ã€åº”ç”¨ã€æ•°æ®åº“ï¼‰åœ¨æ­£ç¡®çš„æ—¶é—´åšæ­£ç¡®çš„äº‹æƒ…ï¼Œè®©æ•´ä¸ªå‡çº§è¿‡ç¨‹åƒä¸€é¦–ä¼˜ç¾çš„äº¤å“ä¹ä¸€æ ·æœ‰åºè¿›è¡Œã€‚

**ğŸ”¸ è‡ªåŠ¨åŒ–ç¼–æ’çš„ä»·å€¼**
```
å‡å°‘äººä¸ºé”™è¯¯ï¼š
â€¢ æ ‡å‡†åŒ–æµç¨‹ï¼šæ¯æ¬¡å‡çº§éƒ½æŒ‰ç…§ç›¸åŒæ­¥éª¤æ‰§è¡Œ
â€¢ è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼šç¨‹åºæ¯”äººæ›´ç²¾ç¡®åœ°æ‰§è¡Œæ£€æŸ¥
â€¢ é”™è¯¯æ¢å¤ï¼šè‡ªåŠ¨è¯†åˆ«é”™è¯¯å¹¶æ‰§è¡Œæ¢å¤åŠ¨ä½œ

æé«˜æ•ˆç‡ï¼š
â€¢ å¹¶è¡Œæ‰§è¡Œï¼šå¤šä¸ªèŠ‚ç‚¹å¯ä»¥åŒæ—¶å¤„ç†
â€¢ å¿«é€Ÿå“åº”ï¼šè‡ªåŠ¨æ£€æµ‹çŠ¶æ€å˜åŒ–å¹¶ä½œå‡ºå“åº”
â€¢ 24/7å¯ç”¨ï¼šä¸å—äººå·¥æ—¶é—´é™åˆ¶

å¢å¼ºå¯é æ€§ï¼š
â€¢ çŠ¶æ€è¿½è¸ªï¼šå®æ—¶è®°å½•æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡ŒçŠ¶æ€
â€¢ å›æ»šèƒ½åŠ›ï¼šå‡ºç°é—®é¢˜æ—¶è‡ªåŠ¨å›æ»š
â€¢ é€šçŸ¥æœºåˆ¶ï¼šåŠæ—¶é€šçŸ¥ç›¸å…³äººå‘˜
```

### 12.2 ç¼–æ’å·¥å…·é€‰æ‹©


**ğŸ› ï¸ ä¸»æµç¼–æ’å·¥å…·å¯¹æ¯”**

| å·¥å…·åç§° | **é€‚ç”¨åœºæ™¯** | **å­¦ä¹ éš¾åº¦** | **åŠŸèƒ½ç‰¹ç‚¹** |
|---------|-------------|-------------|-------------|
| ğŸ³ **Kubernetes** | å®¹å™¨åŒ–ç¯å¢ƒ | é«˜ | å¼ºå¤§çš„èµ„æºç®¡ç† |
| ğŸ”§ **Ansible** | ä¼ ç»ŸæœåŠ¡å™¨ | ä¸­ | ç®€å•æ˜“ç”¨ï¼Œæ— éœ€Agent |
| ğŸŒŠ **Terraform** | åŸºç¡€è®¾æ–½ | ä¸­ | åŸºç¡€è®¾æ–½å³ä»£ç  |
| âš¡ **Jenkins** | CI/CD | ä½ | ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ |
| ğŸ“Š **è‡ªç ”è„šæœ¬** | ç‰¹å®šéœ€æ±‚ | ä½ | å®Œå…¨å®šåˆ¶åŒ– |

### 12.3 ç¼–æ’æµç¨‹è®¾è®¡


**ğŸ”„ æ ‡å‡†ç¼–æ’æµç¨‹**
```yaml
# Ansibleç¼–æ’ç¤ºä¾‹ - mysql_upgrade_playbook.yml
---
- name: MySQL InnoDB Clusterå‡çº§ç¼–æ’
  hosts: mysql_cluster
  serial: 1  # ä¸€æ¬¡åªå‡çº§ä¸€ä¸ªèŠ‚ç‚¹
  
  vars:
    mysql_target_version: "8.0.36"
    backup_dir: "/backup/mysql"
    
  tasks:
    # 1. é¢„æ£€æŸ¥é˜¶æ®µ
    - name: æ£€æŸ¥ç³»ç»Ÿèµ„æº
      include_tasks: tasks/check_system_resources.yml
      
    - name: æ£€æŸ¥é›†ç¾¤çŠ¶æ€
      include_tasks: tasks/check_cluster_status.yml
      
    # 2. å¤‡ä»½é˜¶æ®µ
    - name: åˆ›å»ºæ•°æ®å¤‡ä»½
      include_tasks: tasks/create_backup.yml
      
    # 3. å‡çº§é˜¶æ®µ
    - name: å‡çº§MySQLç‰ˆæœ¬
      include_tasks: tasks/upgrade_mysql.yml
      when: inventory_hostname != mysql_primary_node
      
    # 4. éªŒè¯é˜¶æ®µ
    - name: éªŒè¯å‡çº§ç»“æœ
      include_tasks: tasks/verify_upgrade.yml
      
    # 5. æ¸…ç†é˜¶æ®µ
    - name: æ¸…ç†ä¸´æ—¶æ–‡ä»¶
      include_tasks: tasks/cleanup.yml
```

**ğŸ”§ å…·ä½“ä»»åŠ¡æ¨¡å—ç¤ºä¾‹**
```yaml
# tasks/check_cluster_status.yml
---
- name: æ£€æŸ¥MySQLé›†ç¾¤çŠ¶æ€
  shell: |
    mysqlsh --uri={{ mysql_admin_user }}:{{ mysql_admin_password }}@localhost:3306 \
    --execute "cluster = dba.getCluster(); cluster.status()"
  register: cluster_status
  
- name: éªŒè¯æ‰€æœ‰èŠ‚ç‚¹åœ¨çº¿
  fail:
    msg: "é›†ç¾¤çŠ¶æ€å¼‚å¸¸ï¼Œæ— æ³•è¿›è¡Œå‡çº§"
  when: "'ONLINE' not in cluster_status.stdout"

- name: æ£€æŸ¥æ•°æ®åŒæ­¥çŠ¶æ€
  mysql_query:
    login_host: localhost
    login_user: "{{ mysql_admin_user }}"
    login_password: "{{ mysql_admin_password }}"
    query: "SHOW SLAVE STATUS"
  register: slave_status
  
- name: éªŒè¯åŒæ­¥å»¶è¿Ÿ
  fail:
    msg: "æ•°æ®åŒæ­¥å»¶è¿Ÿè¿‡é«˜: {{ slave_status.query_result[0].Seconds_Behind_Master }}ç§’"
  when: slave_status.query_result[0].Seconds_Behind_Master|int > 10
```

### 12.4 é«˜çº§ç¼–æ’ç‰¹æ€§


**ğŸš€ æ™ºèƒ½æ•…éšœå¤„ç†**
```python
# Pythonç¼–æ’è„šæœ¬ç¤ºä¾‹
class MySQLUpgradeOrchestrator:
    def __init__(self):
        self.cluster_nodes = []
        self.current_step = ""
        self.rollback_stack = []
    
    def execute_upgrade(self):
        """æ‰§è¡Œè‡ªåŠ¨åŒ–å‡çº§"""
        try:
            self.validate_prerequisites()
            self.create_checkpoints()
            
            for node in self.get_secondary_nodes():
                self.upgrade_node_with_retry(node)
                
            self.upgrade_primary_node()
            self.final_validation()
            
        except Exception as e:
            self.handle_upgrade_failure(e)
    
    def upgrade_node_with_retry(self, node, max_retries=3):
        """å¸¦é‡è¯•æœºåˆ¶çš„èŠ‚ç‚¹å‡çº§"""
        for attempt in range(max_retries):
            try:
                # åˆ›å»ºæ¢å¤ç‚¹
                checkpoint = self.create_node_checkpoint(node)
                self.rollback_stack.append(checkpoint)
                
                # æ‰§è¡Œå‡çº§
                self.upgrade_single_node(node)
                
                # éªŒè¯å‡çº§ç»“æœ
                if self.verify_node_upgrade(node):
                    print(f"âœ… èŠ‚ç‚¹ {node} å‡çº§æˆåŠŸ")
                    return
                else:
                    raise Exception("èŠ‚ç‚¹éªŒè¯å¤±è´¥")
                    
            except Exception as e:
                print(f"âŒ èŠ‚ç‚¹ {node} å‡çº§å¤±è´¥ (å°è¯• {attempt + 1}/{max_retries}): {e}")
                
                if attempt < max_retries - 1:
                    self.rollback_node(node, checkpoint)
                    time.sleep(60)  # ç­‰å¾…1åˆ†é’Ÿåé‡è¯•
                else:
                    raise Exception(f"èŠ‚ç‚¹ {node} å‡çº§å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")
    
    def handle_upgrade_failure(self, error):
        """å¤„ç†å‡çº§å¤±è´¥"""
        print(f"ğŸš¨ å‡çº§è¿‡ç¨‹å‡ºç°é”™è¯¯: {error}")
        
        # è‡ªåŠ¨å›æ»šåˆ°æœ€è¿‘çš„æ£€æŸ¥ç‚¹
        while self.rollback_stack:
            checkpoint = self.rollback_stack.pop()
            try:
                self.restore_checkpoint(checkpoint)
                print(f"âœ… å·²å›æ»šåˆ°æ£€æŸ¥ç‚¹: {checkpoint['timestamp']}")
            except Exception as rollback_error:
                print(f"âŒ å›æ»šå¤±è´¥: {rollback_error}")
        
        # å‘é€å‘Šè­¦é€šçŸ¥
        self.send_alert_notification(error)
```

**ğŸ“Š å®æ—¶ç›‘æ§é›†æˆ**
```python
def monitor_upgrade_progress():
    """å®æ—¶ç›‘æ§å‡çº§è¿›åº¦"""
    
    metrics_to_monitor = [
        'cluster_status',
        'replication_lag', 
        'active_connections',
        'query_response_time',
        'error_rate'
    ]
    
    while upgrade_in_progress:
        current_metrics = {}
        
        for metric in metrics_to_monitor:
            current_metrics[metric] = collect_metric(metric)
        
        # æ£€æŸ¥å¼‚å¸¸æŒ‡æ ‡
        anomalies = detect_anomalies(current_metrics)
        
        if anomalies:
            # è§¦å‘è‡ªåŠ¨å¹²é¢„
            handle_anomalies(anomalies)
        
        # æ›´æ–°å‡çº§è¿›åº¦
        update_progress_dashboard(current_metrics)
        
        time.sleep(30)  # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
```

---

## 13. ğŸ›¡ï¸ ç»´æŠ¤å½±å“æœ€å°åŒ–æŠ€æœ¯


### 13.1 å½±å“æœ€å°åŒ–åŸºæœ¬åŸç†


**ğŸ’¡ ä»€ä¹ˆæ˜¯å½±å“æœ€å°åŒ–ï¼Ÿ**
å°±åƒå¤–ç§‘åŒ»ç”Ÿåšæ‰‹æœ¯æ—¶è¿½æ±‚æœ€å°åˆ›ä¼¤ä¸€æ ·ï¼Œæ•°æ®åº“ç»´æŠ¤ä¹Ÿè¦è¿½æ±‚å¯¹ä¸šåŠ¡çš„æœ€å°å½±å“ã€‚æ ¸å¿ƒç›®æ ‡æ˜¯è®©ç”¨æˆ·æ„Ÿè§‰ä¸åˆ°ç³»ç»Ÿåœ¨"åšæ‰‹æœ¯"ã€‚

**ğŸ”¸ å½±å“æœ€å°åŒ–çš„ç»´åº¦**
```
æ—¶é—´ç»´åº¦ï¼š
â€¢ ç¼©çŸ­ç»´æŠ¤æ—¶é—´ï¼šæé«˜æ“ä½œæ•ˆç‡
â€¢ é€‰æ‹©æœ€ä½³æ—¶æœºï¼šé¿å¼€ä¸šåŠ¡é«˜å³°æœŸ
â€¢ åˆ†é˜¶æ®µæ‰§è¡Œï¼šåŒ–æ•´ä¸ºé›¶ï¼Œåˆ†æ•£å½±å“

ç©ºé—´ç»´åº¦ï¼š
â€¢ éƒ¨åˆ†èŠ‚ç‚¹ç»´æŠ¤ï¼šä¿è¯å…¶ä»–èŠ‚ç‚¹ç»§ç»­æœåŠ¡
â€¢ æ¸è¿›å¼åˆ‡æ¢ï¼šé€æ­¥è¿ç§»è´Ÿè½½
â€¢ æ™ºèƒ½è·¯ç”±ï¼šå°†è¯·æ±‚è·¯ç”±åˆ°å¥åº·èŠ‚ç‚¹

åŠŸèƒ½ç»´åº¦ï¼š
â€¢ æ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆï¼šç¡®ä¿å…³é”®ä¸šåŠ¡ä¸ä¸­æ–­
â€¢ é™çº§æœåŠ¡ï¼šä¸´æ—¶å…³é—­éå…³é”®åŠŸèƒ½
â€¢ ç¼“å­˜åˆ©ç”¨ï¼šåˆ©ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“å‹åŠ›
```

### 13.2 è¿æ¥ç®¡ç†ä¼˜åŒ–


**ğŸ”— æ™ºèƒ½è¿æ¥ç®¡ç†ç­–ç•¥**
```python
class ConnectionManager:
    def __init__(self):
        self.connection_pools = {}
        self.maintenance_mode = False
        self.graceful_shutdown_timeout = 300  # 5åˆ†é’Ÿ
        
    def enter_maintenance_mode(self, target_node):
        """è¿›å…¥ç»´æŠ¤æ¨¡å¼çš„è¿æ¥ç®¡ç†"""
        print(f"èŠ‚ç‚¹ {target_node} è¿›å…¥ç»´æŠ¤æ¨¡å¼")
        
        # 1. åœæ­¢æ–°è¿æ¥åˆ†é…åˆ°ç›®æ ‡èŠ‚ç‚¹
        self.stop_new_connections(target_node)
        
        # 2. ä¼˜é›…å…³é—­ç°æœ‰è¿æ¥
        self.graceful_connection_drain(target_node)
        
        # 3. ç­‰å¾…æ´»è·ƒäº‹åŠ¡å®Œæˆ
        self.wait_for_active_transactions(target_node)
        
        # 4. å¼ºåˆ¶å…³é—­å‰©ä½™è¿æ¥ï¼ˆå¦‚æœéœ€è¦ï¼‰
        self.force_close_remaining_connections(target_node)
        
    def stop_new_connections(self, target_node):
        """åœæ­¢å‘ç›®æ ‡èŠ‚ç‚¹åˆ†é…æ–°è¿æ¥"""
        # æ›´æ–°è´Ÿè½½å‡è¡¡é…ç½®
        lb_config = {
            'backend_servers': [
                node for node in self.get_active_nodes() 
                if node != target_node
            ]
        }
        self.update_load_balancer_config(lb_config)
        
    def graceful_connection_drain(self, target_node):
        """ä¼˜é›…åœ°æ’ç©ºè¿æ¥"""
        active_connections = self.get_active_connections(target_node)
        
        for conn in active_connections:
            if conn.is_idle():
                # ç©ºé—²è¿æ¥ç›´æ¥å…³é—­
                conn.close()
            else:
                # æ´»è·ƒè¿æ¥æ ‡è®°ä¸ºä¸å†ä½¿ç”¨
                conn.mark_for_closure()
                # è®¾ç½®è¿æ¥è¶…æ—¶ï¼Œè‡ªç„¶è¿‡æœŸ
                conn.set_timeout(self.graceful_shutdown_timeout)
        
    def wait_for_active_transactions(self, target_node, max_wait_time=300):
        """ç­‰å¾…æ´»è·ƒäº‹åŠ¡å®Œæˆ"""
        start_time = time.time()
        
        while time.time() - start_time < max_wait_time:
            active_txns = self.get_active_transactions(target_node)
            
            if len(active_txns) == 0:
                print(f"âœ… èŠ‚ç‚¹ {target_node} æ‰€æœ‰äº‹åŠ¡å·²å®Œæˆ")
                return True
                
            print(f"â³ ç­‰å¾… {len(active_txns)} ä¸ªäº‹åŠ¡å®Œæˆ...")
            time.sleep(10)
        
        # è¶…æ—¶åçš„å¤„ç†
        remaining_txns = self.get_active_transactions(target_node)
        if remaining_txns:
            print(f"âš ï¸ ä»æœ‰ {len(remaining_txns)} ä¸ªäº‹åŠ¡æœªå®Œæˆï¼Œå°†å¼ºåˆ¶ç»ˆæ­¢")
            return False
        
        return True
```

### 13.3 è¯»å†™åˆ†ç¦»ä¼˜åŒ–


**ğŸ“– æ™ºèƒ½è¯»å†™åˆ†ç¦»ç­–ç•¥**
```sql
-- ç»´æŠ¤æœŸé—´çš„è¯»å†™åˆ†ç¦»é…ç½®
-- ä½¿ç”¨ProxySQLå®ç°æ™ºèƒ½è·¯ç”±

-- 1. é…ç½®è¯»å†™åˆ†ç¦»è§„åˆ™
INSERT INTO mysql_query_rules (
    rule_id, active, match_pattern, destination_hostgroup, apply
) VALUES 
(1, 1, '^SELECT.*', 1, 1),  -- è¯»è¯·æ±‚è·¯ç”±åˆ°è¯»èŠ‚ç‚¹ç»„
(2, 1, '^INSERT|UPDATE|DELETE.*', 0, 1);  -- å†™è¯·æ±‚è·¯ç”±åˆ°å†™èŠ‚ç‚¹ç»„

-- 2. é…ç½®ç»´æŠ¤æœŸé—´çš„ç‰¹æ®Šè§„åˆ™
INSERT INTO mysql_query_rules (
    rule_id, active, match_pattern, destination_hostgroup, apply
) VALUES 
(100, 1, '.*', 2, 1);  -- ç»´æŠ¤æœŸé—´æ‰€æœ‰è¯·æ±‚è·¯ç”±åˆ°å¤‡ç”¨èŠ‚ç‚¹ç»„

-- 3. åŠ¨æ€åˆ‡æ¢è§„åˆ™
UPDATE mysql_query_rules 
SET active = 0 
WHERE rule_id IN (1, 2);  -- ç¦ç”¨æ­£å¸¸è§„åˆ™

UPDATE mysql_query_rules 
SET active = 1 
WHERE rule_id = 100;  -- å¯ç”¨ç»´æŠ¤è§„åˆ™

LOAD MYSQL QUERY RULES TO RUNTIME;
SAVE MYSQL QUERY RULES TO DISK;
```

### 13.4 ç¼“å­˜é¢„çƒ­ç­–ç•¥


**ğŸ”¥ æ™ºèƒ½ç¼“å­˜é¢„çƒ­**
```python
class CacheWarmupManager:
    def __init__(self):
        self.cache_hit_threshold = 0.95  # ç¼“å­˜å‘½ä¸­ç‡ç›®æ ‡
        self.warmup_queries = []
        
    def prepare_maintenance_warmup(self, target_node):
        """ç»´æŠ¤å‰çš„ç¼“å­˜é¢„çƒ­å‡†å¤‡"""
        
        # 1. åˆ†æçƒ­ç‚¹æŸ¥è¯¢
        hot_queries = self.analyze_hot_queries(target_node)
        
        # 2. é¢„çƒ­å…¶ä»–èŠ‚ç‚¹çš„ç¼“å­˜
        for node in self.get_other_nodes(target_node):
            self.warmup_node_cache(node, hot_queries)
        
        # 3. éªŒè¯ç¼“å­˜é¢„çƒ­æ•ˆæœ
        self.verify_warmup_effectiveness()
        
    def analyze_hot_queries(self, node):
        """åˆ†æçƒ­ç‚¹æŸ¥è¯¢"""
        query = """
        SELECT digest_text, count_star, avg_timer_wait
        FROM performance_schema.events_statements_summary_by_digest 
        WHERE schema_name NOT IN ('information_schema', 'performance_schema', 'sys')
        ORDER BY count_star DESC 
        LIMIT 100
        """
        
        hot_queries = self.execute_query(node, query)
        
        # æå–å…³é”®è¡¨å’ŒæŸ¥è¯¢æ¨¡å¼
        important_queries = []
        for row in hot_queries:
            if self.is_cacheable_query(row['digest_text']):
                important_queries.append({
                    'query_pattern': row['digest_text'],
                    'frequency': row['count_star'],
                    'avg_time': row['avg_timer_wait']
                })
        
        return important_queries
    
    def warmup_node_cache(self, node, hot_queries):
        """é¢„çƒ­æŒ‡å®šèŠ‚ç‚¹çš„ç¼“å­˜"""
        print(f"å¼€å§‹é¢„çƒ­èŠ‚ç‚¹ {node} çš„ç¼“å­˜...")
        
        for query_info in hot_queries:
            try:
                # æ‰§è¡ŒæŸ¥è¯¢æ¥é¢„çƒ­ç¼“å­˜
                sample_query = self.generate_sample_query(query_info['query_pattern'])
                self.execute_query(node, sample_query)
                
            except Exception as e:
                print(f"é¢„çƒ­æŸ¥è¯¢å¤±è´¥: {e}")
        
        # æ£€æŸ¥é¢„çƒ­æ•ˆæœ
        cache_hit_rate = self.get_cache_hit_rate(node)
        print(f"èŠ‚ç‚¹ {node} ç¼“å­˜å‘½ä¸­ç‡: {cache_hit_rate:.2%}")
    
    def verify_warmup_effectiveness(self):
        """éªŒè¯é¢„çƒ­æ•ˆæœ"""
        for node in self.get_available_nodes():
            hit_rate = self.get_cache_hit_rate(node)
            
            if hit_rate < self.cache_hit_threshold:
                print(f"âš ï¸ èŠ‚ç‚¹ {node} ç¼“å­˜å‘½ä¸­ç‡åä½: {hit_rate:.2%}")
                # æ‰§è¡Œé¢å¤–çš„é¢„çƒ­
                self.additional_warmup(node)
            else:
                print(f"âœ… èŠ‚ç‚¹ {node} ç¼“å­˜é¢„çƒ­å……åˆ†: {hit_rate:.2%}")
```

### 13.5 ä¸šåŠ¡é™çº§ç­–ç•¥


**ğŸ“‰ è‡ªåŠ¨ä¸šåŠ¡é™çº§æœºåˆ¶**
```python
class BusinessDegradationManager:
    def __init__(self):
        self.degradation_levels = {
            'level_0': {'name': 'æ­£å¸¸æœåŠ¡', 'features': ['all']},
            'level_1': {'name': 'è½»åº¦é™çº§', 'features': ['core', 'important']},
            'level_2': {'name': 'ä¸­åº¦é™çº§', 'features': ['core']},
            'level_3': {'name': 'é‡åº¦é™çº§', 'features': ['readonly']}
        }
        self.current_level = 'level_0'
        
    def assess_degradation_need(self, system_metrics):
        """è¯„ä¼°æ˜¯å¦éœ€è¦ä¸šåŠ¡é™çº§"""
        degradation_score = 0
        
        # æ ¹æ®ç³»ç»ŸæŒ‡æ ‡è®¡ç®—é™çº§åˆ†æ•°
        if system_metrics['cpu_usage'] > 80:
            degradation_score += 20
        if system_metrics['memory_usage'] > 85:
            degradation_score += 20
        if system_metrics['response_time'] > 1000:  # 1ç§’
            degradation_score += 30
        if system_metrics['error_rate'] > 0.01:  # 1%
            degradation_score += 30
        
        # å†³å®šé™çº§çº§åˆ«
        if degradation_score >= 60:
            return 'level_3'
        elif degradation_score >= 40:
            return 'level_2'
        elif degradation_score >= 20:
            return 'level_1'
        else:
            return 'level_0'
    
    def apply_degradation(self, target_level):
        """åº”ç”¨ä¸šåŠ¡é™çº§ç­–ç•¥"""
        if target_level == self.current_level:
            return  # æ— éœ€å˜æ›´
        
        print(f"ä¸šåŠ¡é™çº§: {self.current_level} â†’ {target_level}")
        
        degradation_config = self.degradation_levels[target_level]
        
        # é…ç½®åŠŸèƒ½å¼€å…³
        feature_switches = {
            'core': True if 'core' in degradation_config['features'] else False,
            'important': True if 'important' in degradation_config['features'] else False,
            'optional': True if 'optional' in degradation_config['features'] else False,
            'readonly': True if 'readonly' in degradation_config['features'] else False
        }
        
        # åº”ç”¨é…ç½®åˆ°å„ä¸ªæœåŠ¡
        self.update_service_config(feature_switches)
        
        # æ›´æ–°å½“å‰çŠ¶æ€
        self.current_level = target_level
        
        # å‘é€é€šçŸ¥
        self.notify_degradation_change(target_level)
    
    def update_service_config(self, feature_switches):
        """æ›´æ–°æœåŠ¡é…ç½®"""
        # è¿™é‡Œå®ç°å…·ä½“çš„æœåŠ¡é…ç½®æ›´æ–°é€»è¾‘
        # å¯ä»¥é€šè¿‡é…ç½®ä¸­å¿ƒã€APIè°ƒç”¨ç­‰æ–¹å¼å®ç°
        
        config_updates = {
            'feature_flags': feature_switches,
            'circuit_breaker': {
                'enabled': not feature_switches['core'],
                'failure_threshold': 5,
                'timeout': 30
            },
            'rate_limiting': {
                'enabled': True,
                'requests_per_second': 100 if not feature_switches['optional'] else 1000
            }
        }
        
        # æ¨é€é…ç½®æ›´æ–°
        self.push_config_updates(config_updates)
```

---

## 14. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 14.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ å‡çº§ä¸ç»´æŠ¤çš„æœ¬è´¨ç†è§£**
```
ğŸ”¸ å‡çº§ç›®æ ‡ï¼šåœ¨ä¿è¯ä¸šåŠ¡è¿ç»­æ€§çš„å‰æä¸‹å®ç°ç‰ˆæœ¬å‡çº§
ğŸ”¸ æ ¸å¿ƒæŒ‘æˆ˜ï¼šå¹³è¡¡å¯ç”¨æ€§ã€ä¸€è‡´æ€§ã€æ€§èƒ½ä¸‰è€…å…³ç³»
ğŸ”¸ æˆåŠŸæ ‡å‡†ï¼šé›¶æ•°æ®ä¸¢å¤±ã€æœ€å°ä¸šåŠ¡å½±å“ã€å¯é¢„æµ‹çš„ç»“æœ
ğŸ”¸ é£é™©æ§åˆ¶ï¼šå®Œå–„çš„å¤‡ä»½ã€å›æ»šã€ç›‘æ§æœºåˆ¶
ğŸ”¸ è‡ªåŠ¨åŒ–ä»·å€¼ï¼šå‡å°‘äººä¸ºé”™è¯¯ã€æé«˜æ•ˆç‡ã€å¢å¼ºå¯é æ€§
```

### 14.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ æ»šåŠ¨å‡çº§æ ¸å¿ƒåŸç†**
```
å®æ–½é¡ºåºï¼šSecondaryèŠ‚ç‚¹ â†’ PrimaryèŠ‚ç‚¹
åŒæ­¥ä¿è¯ï¼šæ¯ä¸ªèŠ‚ç‚¹å‡çº§åç­‰å¾…æ•°æ®åŒæ­¥å®Œæˆ
çŠ¶æ€ç›‘æ§ï¼šå®æ—¶ç›‘æ§é›†ç¾¤çŠ¶æ€å’ŒèŠ‚ç‚¹å¥åº·åº¦
æ•…éšœå¤„ç†ï¼šä»»ä½•é˜¶æ®µå‡ºç°é—®é¢˜éƒ½èƒ½å¿«é€Ÿå›æ»š
```

**ğŸ”¹ é›¶åœæœºå‡çº§æŠ€æœ¯æ ˆ**
```
è¿æ¥ä»£ç†ï¼šæ™ºèƒ½è·¯ç”±è¯·æ±‚åˆ°å¯ç”¨èŠ‚ç‚¹
æ•°æ®åŒæ­¥ï¼šGroup Replicationä¿è¯å®æ—¶ä¸€è‡´æ€§
çŠ¶æ€ç®¡ç†ï¼šç²¾ç¡®è·Ÿè¸ªæ¯ä¸ªèŠ‚ç‚¹çš„å‡çº§çŠ¶æ€
ç›‘æ§å‘Šè­¦ï¼šå®æ—¶æ£€æµ‹å¼‚å¸¸å¹¶è‡ªåŠ¨å“åº”
```

**ğŸ”¹ å¤§ç‰ˆæœ¬å‡çº§ç­–ç•¥**
```
é€»è¾‘å¤åˆ¶ï¼šæœ€å®‰å…¨ä½†æœ€å¤æ‚çš„è¿ç§»æ–¹æ¡ˆ
åˆ†é˜¶æ®µæ‰§è¡Œï¼šé™ä½é£é™©ï¼Œä¾¿äºé—®é¢˜å®šä½
å®Œæ•´æµ‹è¯•ï¼šç”Ÿäº§ç¯å¢ƒæ‰§è¡Œå‰å……åˆ†éªŒè¯
æ•°æ®éªŒè¯ï¼šå¤šå±‚æ¬¡ç¡®ä¿æ•°æ®å®Œæ•´æ€§
```

### 14.3 è‡ªåŠ¨åŒ–æœ€ä½³å®è·µ


**ğŸ”§ ç¼–æ’ç³»ç»Ÿè®¾è®¡åŸåˆ™**
```
å¹‚ç­‰æ€§ï¼šåŒä¸€æ“ä½œæ‰§è¡Œå¤šæ¬¡ç»“æœç›¸åŒ
å¯è§‚æµ‹æ€§ï¼šæ¯ä¸ªæ­¥éª¤éƒ½æœ‰è¯¦ç»†æ—¥å¿—å’Œç›‘æ§
æ•…éšœæ¢å¤ï¼šè‡ªåŠ¨æ£€æµ‹æ•…éšœå¹¶æ‰§è¡Œæ¢å¤åŠ¨ä½œ
æ¸è¿›å¼ï¼šå…ˆå°è§„æ¨¡è¯•ç‚¹ï¼Œå†å…¨é¢æ¨å¹¿
äººå·¥å¹²é¢„ï¼šå…³é”®å†³ç­–ç‚¹ä¿ç•™äººå·¥ç¡®è®¤
```

**ğŸ¤– æ™ºèƒ½åŒ–ä¼˜åŒ–æ–¹å‘**
```
ç­–ç•¥é€‰æ‹©ï¼šåŸºäºç¯å¢ƒå’Œå†å²æ•°æ®è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥
åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®å®æ—¶ç›‘æ§æ•°æ®åŠ¨æ€ä¼˜åŒ–æ‰§è¡Œè¿‡ç¨‹
æœºå™¨å­¦ä¹ ï¼šåˆ©ç”¨å†å²æ•°æ®ä¸æ–­æ”¹è¿›å†³ç­–æ¨¡å‹
é¢„æµ‹èƒ½åŠ›ï¼šæå‰é¢„æµ‹å¯èƒ½çš„é—®é¢˜å’Œç“¶é¢ˆ
```

### 14.4 å½±å“æœ€å°åŒ–æŠ€æœ¯ç²¾é«“


**ğŸ›¡ï¸ è¿æ¥ç®¡ç†ä¼˜åŒ–**
```
ä¼˜é›…å…³é—­ï¼šç»™æ´»è·ƒè¿æ¥å……åˆ†æ—¶é—´å®Œæˆå½“å‰äº‹åŠ¡
æ™ºèƒ½è·¯ç”±ï¼šè‡ªåŠ¨å°†æ–°è¯·æ±‚è·¯ç”±åˆ°å¥åº·èŠ‚ç‚¹
è¿æ¥æ± ï¼šå¤ç”¨è¿æ¥å‡å°‘å»ºè¿å¼€é”€
è¶…æ—¶æ§åˆ¶ï¼šåˆç†è®¾ç½®å„ç§è¶…æ—¶å‚æ•°
```

**ğŸ“Š æ€§èƒ½å½±å“æ§åˆ¶**
```
ç¼“å­˜é¢„çƒ­ï¼šç»´æŠ¤å‰é¢„çƒ­å…¶ä»–èŠ‚ç‚¹ç¼“å­˜
è¯»å†™åˆ†ç¦»ï¼šç»´æŠ¤æœŸé—´å°†è´Ÿè½½è½¬ç§»åˆ°å…¶ä»–èŠ‚ç‚¹
ä¸šåŠ¡é™çº§ï¼šå¿…è¦æ—¶ä¸´æ—¶å…³é—­éæ ¸å¿ƒåŠŸèƒ½
èµ„æºé¢„ç•™ï¼šä¸ºå‡çº§è¿‡ç¨‹é¢„ç•™è¶³å¤Ÿç³»ç»Ÿèµ„æº
```

### 14.5 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… å‡çº§å‰å¿…åšæ£€æŸ¥æ¸…å•**
- [ ] **ç¯å¢ƒéªŒè¯**ï¼šæµ‹è¯•ç¯å¢ƒå®Œæ•´éªŒè¯å‡çº§æµç¨‹
- [ ] **å¤‡ä»½ç¡®è®¤**ï¼šæœ€æ–°çš„å…¨é‡å’Œå¢é‡å¤‡ä»½å¯ç”¨
- [ ] **å›æ»šå‡†å¤‡**ï¼šè¯¦ç»†çš„å›æ»šè®¡åˆ’å’Œæ—¶é—´é¢„ä¼°
- [ ] **ç›‘æ§å°±ç»ª**ï¼šæ‰€æœ‰ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] **å›¢é˜Ÿå‡†å¤‡**ï¼šç›¸å…³æŠ€æœ¯äººå‘˜åœ¨çº¿å¾…å‘½

**âš ï¸ å¸¸è§é£é™©å’Œåº”å¯¹**
```
é…ç½®ä¸å…¼å®¹ï¼š
é£é™©ï¼šæ–°ç‰ˆæœ¬å‚æ•°ä¸æ—§é…ç½®å†²çª
åº”å¯¹ï¼šå‡çº§å‰è¿›è¡Œé…ç½®å…¼å®¹æ€§æ£€æŸ¥

æ€§èƒ½é€€åŒ–ï¼š
é£é™©ï¼šæ–°ç‰ˆæœ¬æ€§èƒ½ä¸å¦‚é¢„æœŸ
åº”å¯¹ï¼šå»ºç«‹æ€§èƒ½åŸºçº¿ï¼ŒåŠæ—¶å¯¹æ¯”åˆ†æ

æ•°æ®æŸåï¼š
é£é™©ï¼šå‡çº§è¿‡ç¨‹ä¸­æ•°æ®æ–‡ä»¶æŸå
åº”å¯¹ï¼šå¤šé‡å¤‡ä»½ï¼Œæ ¡éªŒå’ŒéªŒè¯

åº”ç”¨å…¼å®¹æ€§ï¼š
é£é™©ï¼šåº”ç”¨ç¨‹åºä¸æ–°ç‰ˆæœ¬ä¸å…¼å®¹
åº”å¯¹ï¼šåº”ç”¨å±‚å……åˆ†æµ‹è¯•ï¼Œç°åº¦å‘å¸ƒ
```

**ğŸ”„ æŒç»­æ”¹è¿›ç­–ç•¥**
```
ç»éªŒæ€»ç»“ï¼šæ¯æ¬¡å‡çº§åæ€»ç»“ç»éªŒæ•™è®­
æµç¨‹ä¼˜åŒ–ï¼šæ ¹æ®å®é™…æƒ…å†µæŒç»­ä¼˜åŒ–å‡çº§æµç¨‹
å·¥å…·å®Œå–„ï¼šå¼€å‘æ›´æ™ºèƒ½çš„è‡ªåŠ¨åŒ–å·¥å…·
çŸ¥è¯†æ²‰æ·€ï¼šå»ºç«‹å‡çº§çŸ¥è¯†åº“å’Œæœ€ä½³å®è·µ
å›¢é˜ŸåŸ¹è®­ï¼šå®šæœŸåŸ¹è®­æå‡å›¢é˜ŸæŠ€èƒ½æ°´å¹³
```

### 14.6 æ ¸å¿ƒè®°å¿†è¦ç‚¹


**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
"å‡çº§ä¸‰æ­¥èµ°ï¼Œå¤‡ä»½ä¸èƒ½ä¸¢"
"æ»šåŠ¨è¦æœ‰åºï¼Œç›‘æ§éœ€åˆ°ä½"  
"é›¶åœæœºæœ‰é“ï¼Œä»£ç†æ¥å¼•å¯¼"
"è‡ªåŠ¨åŒ–ç¼–æ’ï¼Œæ™ºèƒ½æ¥å¸®å¿™"
"å½±å“è¦æœ€å°ï¼Œä½“éªŒæ˜¯ç›®æ ‡"
```

**ğŸ¯ æˆåŠŸå‡çº§çš„æ ‡å¿—**ï¼š
- âœ… æ‰€æœ‰èŠ‚ç‚¹ç‰ˆæœ¬ç»Ÿä¸€ï¼ŒçŠ¶æ€æ­£å¸¸
- âœ… ä¸šåŠ¡åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼Œæ€§èƒ½è¾¾æ ‡
- âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡
- âœ… ç›‘æ§æŒ‡æ ‡æ¢å¤æ­£å¸¸èŒƒå›´
- âœ… ç”¨æˆ·ä½“éªŒæ— æ˜æ˜¾å½±å“

**æ ¸å¿ƒä»·å€¼**ï¼šé€šè¿‡ç³»ç»ŸåŒ–çš„å‡çº§ç»´æŠ¤æ–¹æ³•ï¼Œå®ç°MySQL InnoDB Clusterçš„å¹³æ»‘å‡çº§ï¼Œç¡®ä¿ä¸šåŠ¡è¿ç»­æ€§çš„åŒæ—¶è·å¾—æ–°ç‰ˆæœ¬çš„åŠŸèƒ½å’Œæ€§èƒ½æå‡ã€‚æŒæ¡è¿™äº›æŠ€æœ¯ä¸ä»…èƒ½å¤Ÿèƒœä»»æ—¥å¸¸çš„æ•°æ®åº“ç»´æŠ¤å·¥ä½œï¼Œæ›´èƒ½åœ¨å…³é”®æ—¶åˆ»ä¿éšœä¸šåŠ¡çš„ç¨³å®šè¿è¡Œã€‚