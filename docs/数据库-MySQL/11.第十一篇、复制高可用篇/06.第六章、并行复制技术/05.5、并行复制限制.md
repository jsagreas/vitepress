---
title: 5ã€å¹¶è¡Œå¤åˆ¶é™åˆ¶
---
## ğŸ“š ç›®å½•

1. [å¹¶è¡Œå¤åˆ¶é™åˆ¶æ¦‚è¿°](#1-å¹¶è¡Œå¤åˆ¶é™åˆ¶æ¦‚è¿°)
2. [çº¦æŸä¸ä¸æ”¯æŒåœºæ™¯](#2-çº¦æŸä¸ä¸æ”¯æŒåœºæ™¯)
3. [å…¼å®¹æ€§é™åˆ¶è¯¦è§£](#3-å…¼å®¹æ€§é™åˆ¶è¯¦è§£)
4. [æ€§èƒ½é™åˆ¶å› ç´ åˆ†æ](#4-æ€§èƒ½é™åˆ¶å› ç´ åˆ†æ)
5. [ç‰ˆæœ¬å·®å¼‚é™åˆ¶](#5-ç‰ˆæœ¬å·®å¼‚é™åˆ¶)
6. [å¤–é”®çº¦æŸçš„å½±å“](#6-å¤–é”®çº¦æŸçš„å½±å“)
7. [è§¦å‘å™¨å…¼å®¹æ€§é—®é¢˜](#7-è§¦å‘å™¨å…¼å®¹æ€§é—®é¢˜)
8. [å¤§äº‹åŠ¡æ€§èƒ½å½±å“](#8-å¤§äº‹åŠ¡æ€§èƒ½å½±å“)
9. [é™åˆ¶æ£€æµ‹ä¸è§„é¿ç­–ç•¥](#9-é™åˆ¶æ£€æµ‹ä¸è§„é¿ç­–ç•¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš« å¹¶è¡Œå¤åˆ¶é™åˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¹¶è¡Œå¤åˆ¶é™åˆ¶


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
```
å¹¶è¡Œå¤åˆ¶é™åˆ¶ï¼šæŒ‡åœ¨ä½¿ç”¨MySQLå¹¶è¡Œå¤åˆ¶åŠŸèƒ½æ—¶ï¼Œ
ç”±äºæŠ€æœ¯æ¶æ„ã€æ•°æ®ä¸€è‡´æ€§è¦æ±‚æˆ–å…¼å®¹æ€§è€ƒè™‘ï¼Œ
å¯¼è‡´æŸäº›åœºæ™¯ä¸‹æ— æ³•æ­£å¸¸å·¥ä½œæˆ–æ€§èƒ½å—é™çš„çº¦æŸæ¡ä»¶ã€‚
```

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> å°±åƒé«˜é€Ÿå…¬è·¯ä¸Šçš„å¤šè½¦é“ï¼Œè™½ç„¶èƒ½æé«˜é€šè¡Œæ•ˆç‡ï¼Œä½†é‡åˆ°æ–½å·¥è·¯æ®µã€æ¡¥æ¢é™é‡æˆ–æ¶åŠ£å¤©æ°”æ—¶ï¼Œå°±å¿…é¡»é™åˆ¶è½¦é“æ•°é‡æˆ–é™ä½è½¦é€Ÿï¼Œç”šè‡³æ”¹ä¸ºå•è½¦é“é€šè¡Œã€‚

### 1.2 é™åˆ¶äº§ç”Ÿçš„æ ¹æœ¬åŸå› 


**ğŸ“Š æ ¹å› åˆ†æ**
```
æ•°æ®ä¸€è‡´æ€§è¦æ±‚
â”œâ”€â”€ äº‹åŠ¡ACIDç‰¹æ€§ä¿è¯
â”œâ”€â”€ ä¸»ä»æ•°æ®å®Œæ•´æ€§ç»´æŠ¤  
â””â”€â”€ å¤åˆ¶é¡ºåºä¾èµ–å…³ç³»

æŠ€æœ¯æ¶æ„çº¦æŸ
â”œâ”€â”€ MySQLå†…æ ¸è®¾è®¡é™åˆ¶
â”œâ”€â”€ å­˜å‚¨å¼•æ“ç‰¹æ€§å·®å¼‚
â””â”€â”€ ç½‘ç»œä¼ è¾“æœºåˆ¶çº¦æŸ

å…¼å®¹æ€§è€ƒè™‘
â”œâ”€â”€ ä¸åŒç‰ˆæœ¬é—´å·®å¼‚
â”œâ”€â”€ ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆ
â””â”€â”€ å†å²é—ç•™ç³»ç»Ÿé€‚é…
```

### 1.3 é™åˆ¶ç±»å‹åˆ†ç±»


| é™åˆ¶ç±»å‹ | **å½±å“èŒƒå›´** | **ä¸¥é‡ç¨‹åº¦** | **è§„é¿éš¾åº¦** |
|---------|-------------|-------------|-------------|
| ğŸ”´ **åŠŸèƒ½æ€§é™åˆ¶** | `å®Œå…¨æ— æ³•ä½¿ç”¨` | `é«˜` | `å›°éš¾` |
| ğŸŸ¡ **æ€§èƒ½é™åˆ¶** | `æ•ˆæœæ‰“æŠ˜æ‰£` | `ä¸­` | `ä¸­ç­‰` |
| ğŸŸ¢ **å…¼å®¹æ€§é™åˆ¶** | `ç‰¹å®šåœºæ™¯å—é™` | `ä½` | `å®¹æ˜“` |

---

## 2. âš ï¸ çº¦æŸä¸ä¸æ”¯æŒåœºæ™¯


### 2.1 å®Œå…¨ä¸æ”¯æŒçš„åœºæ™¯


**ğŸš¨ æ³¨æ„äº‹é¡¹**
> ä»¥ä¸‹åœºæ™¯ä¸‹ï¼Œå¹¶è¡Œå¤åˆ¶å¯èƒ½å®Œå…¨å¤±æ•ˆæˆ–å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œå¿…é¡»è°¨æ…å¤„ç†ã€‚

#### 2.1.1 å­˜å‚¨å¼•æ“é™åˆ¶


**ğŸ”¸ MyISAMå¼•æ“è¡¨**
```sql
-- é—®é¢˜ç¤ºä¾‹ï¼šMyISAMä¸æ”¯æŒäº‹åŠ¡
CREATE TABLE user_log (
    id INT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100),
    created_at TIMESTAMP
) ENGINE=MyISAM;

-- å¹¶è¡Œå¤åˆ¶é—®é¢˜ï¼š
-- 1. æ— äº‹åŠ¡è¾¹ç•Œï¼Œæ— æ³•ç¡®å®šæ‰§è¡Œé¡ºåº
-- 2. è¡¨çº§é”å†²çªä¸¥é‡
-- 3. æ•°æ®ä¸€è‡´æ€§æ— æ³•ä¿è¯
```

**ğŸ’¡ å…³é”®æ´å¯Ÿ**
> MyISAMå¼•æ“ç”±äºç¼ºä¹äº‹åŠ¡æ”¯æŒï¼Œæ— æ³•åˆ©ç”¨äº‹åŠ¡è¾¹ç•Œæ¥åˆ¤æ–­å“ªäº›æ“ä½œå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤å¹¶è¡Œå¤åˆ¶å¯¹MyISAMè¡¨çš„æ•ˆæœæå…¶æœ‰é™ã€‚

**âœ… è§£å†³æ–¹æ¡ˆ**
```sql
-- è½¬æ¢ä¸ºInnoDBå¼•æ“
ALTER TABLE user_log ENGINE=InnoDB;

-- æˆ–è€…åœ¨å¤åˆ¶æ—¶æ’é™¤MyISAMè¡¨
SET GLOBAL slave_skip_errors = 'ddl_exist_errors';
```

#### 2.1.2 è‡ªå¢åˆ—ç›¸å…³é™åˆ¶


**ğŸ”¸ AUTO_INCREMENTå¹¶å‘é—®é¢˜**
```sql
-- é—®é¢˜åœºæ™¯
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    customer_id INT,
    order_time TIMESTAMP,
    amount DECIMAL(10,2)
);

-- ä¸»åº“æ‰§è¡Œé¡ºåº
INSERT INTO orders (customer_id, amount) VALUES (100, 299.99); -- id=1
INSERT INTO orders (customer_id, amount) VALUES (101, 399.99); -- id=2

-- ä»åº“å¹¶è¡Œæ‰§è¡Œå¯èƒ½äº§ç”Ÿçš„é—®é¢˜ï¼š
-- çº¿ç¨‹1: INSERT ... VALUES (101, 399.99) -> id=1
-- çº¿ç¨‹2: INSERT ... VALUES (100, 299.99) -> id=2
-- ç»“æœï¼šidå’Œä¸šåŠ¡æ•°æ®ä¸åŒ¹é…
```

**ğŸ”§ è°ƒè¯•æŠ€å·§**
é—®é¢˜ç°è±¡ â†’ AUTO_INCREMENTå€¼é”™ä¹±
å¯èƒ½åŸå›  â†’ å¹¶è¡Œæ‰§è¡Œæ”¹å˜äº†æ’å…¥é¡ºåº  
è§£å†³æ–¹æ³• â†’ ä½¿ç”¨binlog_format=ROWæ¨¡å¼

### 2.2 æ¡ä»¶æ€§é™åˆ¶åœºæ™¯


#### 2.2.1 DDLè¯­å¥é™åˆ¶


**ğŸ“‹ DDLå¹¶è¡Œå¤åˆ¶è§„åˆ™**
```
å®Œå…¨ç¦æ­¢å¹¶è¡Œçš„DDLï¼š
â”œâ”€â”€ ALTER TABLEç»“æ„å˜æ›´
â”œâ”€â”€ CREATE/DROP INDEXæ“ä½œ
â”œâ”€â”€ CREATE/DROP TRIGGER
â””â”€â”€ æ¶‰åŠå…ƒæ•°æ®é”çš„æ“ä½œ

éƒ¨åˆ†æ”¯æŒçš„DDLï¼š
â”œâ”€â”€ CREATE TABLE (ç‹¬ç«‹è¡¨)
â”œâ”€â”€ CREATE DATABASE/SCHEMA  
â””â”€â”€ ä¸æ¶‰åŠæ•°æ®çš„æ“ä½œ
```

**ğŸ” æ·±å…¥æ€è€ƒ**
> ä¸ºä»€ä¹ˆDDLä¸èƒ½å¹¶è¡Œï¼Ÿå› ä¸ºDDLæ“ä½œä¼šè·å–å…ƒæ•°æ®é”(MDL)ï¼Œå¤šä¸ªDDLå¹¶è¡Œæ‰§è¡Œå®¹æ˜“äº§ç”Ÿæ­»é”ï¼Œè€Œä¸”ç»“æ„å˜æ›´çš„é¡ºåºå¯¹æ•°æ®ä¸€è‡´æ€§è‡³å…³é‡è¦ã€‚

#### 2.2.2 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°é™åˆ¶


**ğŸ”¸ å­˜å‚¨è¿‡ç¨‹å¹¶è¡Œé™åˆ¶**
```sql
-- é—®é¢˜ç¤ºä¾‹ï¼šå­˜å‚¨è¿‡ç¨‹å†…éƒ¨çŠ¶æ€ä¸å¯é¢„æµ‹
DELIMITER $$
CREATE PROCEDURE update_user_balance(
    IN user_id INT, 
    IN amount DECIMAL(10,2)
)
BEGIN
    -- è¯»å–å½“å‰ä½™é¢
    DECLARE current_balance DECIMAL(10,2);
    SELECT balance INTO current_balance FROM users WHERE id = user_id;
    
    -- æ›´æ–°ä½™é¢
    UPDATE users SET balance = current_balance + amount WHERE id = user_id;
END$$
DELIMITER ;

-- å¹¶è¡Œæ‰§è¡Œé£é™©ï¼š
-- 1. å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–balanceå€¼
-- 2. è®¡ç®—ç»“æœå¯èƒ½é‡å¤æˆ–ä¸¢å¤±
-- 3. æœ€ç»ˆä½™é¢ä¸æ­£ç¡®
```

---

## 3. ğŸ”„ å…¼å®¹æ€§é™åˆ¶è¯¦è§£


### 3.1 ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ


**ğŸ“Š MySQLç‰ˆæœ¬æ”¯æŒæƒ…å†µ**
```
MySQLç‰ˆæœ¬å…¼å®¹æ€§å¯¹æ¯”ï¼š

MySQL 5.6:
â”œâ”€â”€ åŸºç¡€å¹¶è¡Œå¤åˆ¶ï¼šâŒ ä¸æ”¯æŒ
â”œâ”€â”€ æ•°æ®åº“çº§å¹¶è¡Œï¼šâŒ ä¸æ”¯æŒ  
â””â”€â”€ è¡¨çº§å¹¶è¡Œï¼šâŒ ä¸æ”¯æŒ

MySQL 5.7:
â”œâ”€â”€ æ•°æ®åº“çº§å¹¶è¡Œï¼šâœ… æ”¯æŒ
â”œâ”€â”€ é€»è¾‘æ—¶é’Ÿå¹¶è¡Œï¼šâœ… æ”¯æŒ
â””â”€â”€ å†™é›†åˆå¹¶è¡Œï¼šâš ï¸ æœ‰é™æ”¯æŒ

MySQL 8.0:
â”œâ”€â”€ æ‰€æœ‰å¹¶è¡Œæ¨¡å¼ï¼šâœ… å®Œå…¨æ”¯æŒ
â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–ï¼šâœ… å¤§å¹…æå‡
â””â”€â”€ ç›‘æ§å¢å¼ºï¼šâœ… æ›´å¥½çš„å¯è§‚æµ‹æ€§
```

### 3.2 ä¸»ä»ç‰ˆæœ¬å·®å¼‚å½±å“


**âš ï¸ å¸¸è§è¯¯åŒº**
âŒ é”™è¯¯ç†è§£ï¼šä¸»ä»ç‰ˆæœ¬ä¸åŒä¸å½±å“å¹¶è¡Œå¤åˆ¶
âœ… æ­£ç¡®ç†è§£ï¼šç‰ˆæœ¬å·®å¼‚ä¼šä¸¥é‡å½±å“å¹¶è¡Œå¤åˆ¶æ•ˆæœ

**ğŸ”¸ ç‰ˆæœ¬ä¸åŒ¹é…é—®é¢˜**
```sql
-- ä¸»åº“ï¼šMySQL 8.0 (æ”¯æŒå†™é›†å¹¶è¡Œ)
SET GLOBAL binlog_transaction_dependency_tracking = 'WRITESET';

-- ä»åº“ï¼šMySQL 5.7 (ä¸å®Œå…¨æ”¯æŒå†™é›†)
-- ç»“æœï¼šä»åº“å¯èƒ½æ— æ³•æ­£ç¡®è§£æå†™é›†ä¿¡æ¯ï¼Œé€€åŒ–ä¸ºä¸²è¡Œå¤åˆ¶
```

**ğŸ“ˆ å‡çº§è·¯å¾„å»ºè®®**
```
ç‰ˆæœ¬å‡çº§ç­–ç•¥ï¼š
1ï¸âƒ£ ä¼˜å…ˆå‡çº§ä»åº“åˆ°å…¼å®¹ç‰ˆæœ¬
2ï¸âƒ£ éªŒè¯å¹¶è¡Œå¤åˆ¶åŠŸèƒ½æ­£å¸¸
3ï¸âƒ£ åˆ‡æ¢ä¸»ä»è§’è‰²
4ï¸âƒ£ å‡çº§åŸä¸»åº“ç‰ˆæœ¬
```

### 3.3 ç¬¬ä¸‰æ–¹å·¥å…·å…¼å®¹æ€§


**ğŸ”§ å¸¸è§å·¥å…·é™åˆ¶**
```
ç›‘æ§å·¥å…·å…¼å®¹æ€§ï¼š
â”œâ”€â”€ Percona Toolkitï¼šâœ… å®Œå…¨æ”¯æŒ
â”œâ”€â”€ MySQL Workbenchï¼šâš ï¸ éƒ¨åˆ†åŠŸèƒ½å—é™
â”œâ”€â”€ è‡ªå®šä¹‰ç›‘æ§è„šæœ¬ï¼šâŒ å¯èƒ½éœ€è¦ä¿®æ”¹
â””â”€â”€ ç¬¬ä¸‰æ–¹å¤‡ä»½å·¥å…·ï¼šâš ï¸ éœ€è¦é€‚é…

ç®¡ç†å·¥å…·å½±å“ï¼š
â”œâ”€â”€ phpMyAdminï¼šğŸŸ¢ æ— å½±å“
â”œâ”€â”€ MySQL Shellï¼šâœ… å®Œå…¨å…¼å®¹
â”œâ”€â”€ æ•°æ®åŒæ­¥å·¥å…·ï¼šâš ï¸ éœ€è¦æµ‹è¯•éªŒè¯
â””â”€â”€ ORMæ¡†æ¶ï¼šğŸŸ¡ éƒ¨åˆ†åœºæ™¯éœ€è¦è°ƒæ•´
```

---

## 4. ğŸ“ˆ æ€§èƒ½é™åˆ¶å› ç´ åˆ†æ


### 4.1 ç¡¬ä»¶èµ„æºç“¶é¢ˆ


**ğŸ’» CPUèµ„æºé™åˆ¶**
```
CPUä½¿ç”¨æ¨¡å¼åˆ†æï¼š

å•æ ¸æ€§èƒ½ç“¶é¢ˆï¼š
â”œâ”€â”€ SQLçº¿ç¨‹è§£æbinlogï¼šå•çº¿ç¨‹æ“ä½œ
â”œâ”€â”€ IOçº¿ç¨‹ç½‘ç»œä¼ è¾“ï¼šå•çº¿ç¨‹æ“ä½œ
â””â”€â”€ åè°ƒçº¿ç¨‹è°ƒåº¦å¼€é”€ï¼šé¢å¤–CPUæ¶ˆè€—

å¤šæ ¸åˆ©ç”¨ç‡ï¼š
â”œâ”€â”€ å·¥ä½œçº¿ç¨‹æ•°é‡ï¼šé€šå¸¸è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°
â”œâ”€â”€ çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼šè¿‡å¤šçº¿ç¨‹åè€Œé™ä½æ€§èƒ½
â””â”€â”€ NUMAæ¶æ„å½±å“ï¼šè·¨èŠ‚ç‚¹å†…å­˜è®¿é—®å»¶è¿Ÿ
```

**ğŸ” æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```bash
# æŸ¥çœ‹å¹¶è¡Œå¤åˆ¶çº¿ç¨‹CPUä½¿ç”¨æƒ…å†µ
top -H -p $(pgrep mysqld)

# ç›‘æ§çº¿ç¨‹çŠ¶æ€åˆ†å¸ƒ
mysql> SHOW PROCESSLIST;
mysql> SELECT * FROM performance_schema.threads 
       WHERE NAME LIKE '%slave%';
```

### 4.2 å†…å­˜é™åˆ¶å½±å“


**ğŸ§  å†…å­˜ä½¿ç”¨æ¨¡å¼**
```sql
-- å†…å­˜æ¶ˆè€—å¢åŠ çš„åŸå› 
SHOW VARIABLES LIKE '%slave_parallel%';

-- æ ¸å¿ƒå‚æ•°è¯´æ˜
slave_parallel_workers = 4;     -- 4ä¸ªå·¥ä½œçº¿ç¨‹
slave_pending_jobs_size_max = 134217728;  -- 128MBé˜Ÿåˆ—ç¼“å­˜

-- å†…å­˜ä½¿ç”¨è®¡ç®—
æ€»å†…å­˜éœ€æ±‚ = å·¥ä½œçº¿ç¨‹æ•° Ã— (ç¼“å­˜å¤§å° + è¿æ¥å¼€é”€ + ä¸´æ—¶è¡¨ç©ºé—´)
```

**âš¡ æ€§èƒ½å…³é”®ç‚¹**
```
å†…å­˜ä¼˜åŒ–ç­–ç•¥ï¼š
ğŸ”¸ åˆç†è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°ï¼šä¸è¦è¶…è¿‡CPUæ ¸å¿ƒæ•°
ğŸ”¸ è°ƒæ•´é˜Ÿåˆ—å¤§å°ï¼šå¹³è¡¡å†…å­˜ä½¿ç”¨å’Œå»¶è¿Ÿ
ğŸ”¸ ç›‘æ§å†…å­˜ç¢ç‰‡ï¼šå®šæœŸé‡å¯é¿å…å†…å­˜æ³„æ¼
ğŸ”¸ ä½¿ç”¨å†…å­˜æ± ï¼šå‡å°‘é¢‘ç¹çš„å†…å­˜åˆ†é…/é‡Šæ”¾
```

### 4.3 ç½‘ç»œå¸¦å®½é™åˆ¶


**ğŸŒ ç½‘ç»œç“¶é¢ˆåˆ†æ**
```
ç½‘ç»œé™åˆ¶å› ç´ ï¼š

å¸¦å®½ä¸è¶³ï¼š
â”œâ”€â”€ ä¸»ä»é—´ç½‘ç»œå¸¦å®½é™åˆ¶
â”œâ”€â”€ å¤§äº‹åŠ¡ä¼ è¾“å»¶è¿Ÿå¢åŠ 
â””â”€â”€ å¹¶è¡Œåº¦æ— æ³•å……åˆ†å‘æŒ¥

å»¶è¿Ÿå½±å“ï¼š
â”œâ”€â”€ è·¨åœ°åŸŸå¤åˆ¶å»¶è¿Ÿ
â”œâ”€â”€ ç½‘ç»œæŠ–åŠ¨å½±å“ç¨³å®šæ€§
â””â”€â”€ é‡ä¼ æœºåˆ¶å¢åŠ å¼€é”€
```

**ğŸ“Š ç½‘ç»œç›‘æ§æ–¹æ³•**
```bash
# ç›‘æ§ç½‘ç»œå¸¦å®½ä½¿ç”¨
iftop -i eth0

# æŸ¥çœ‹MySQLç½‘ç»œè¿æ¥çŠ¶æ€
netstat -an | grep 3306

# ç›‘æ§å¤åˆ¶å»¶è¿Ÿ
mysql> SHOW SLAVE STATUS\G
```

---

## 5. ğŸ”¢ ç‰ˆæœ¬å·®å¼‚é™åˆ¶


### 5.1 MySQL 5.7ç‰ˆæœ¬é™åˆ¶


**ğŸ”¸ 5.7ç‰ˆæœ¬ç‰¹æœ‰é™åˆ¶**
```sql
-- ä¸æ”¯æŒçš„å¹¶è¡Œæ¨¡å¼
SET GLOBAL slave_parallel_type = 'LOGICAL_CLOCK';  -- âœ… æ”¯æŒ
SET GLOBAL slave_parallel_type = 'DATABASE';       -- âœ… æ”¯æŒ  
-- å†™é›†æ¨¡å¼æ”¯æŒæœ‰é™ï¼Œç¨³å®šæ€§ä¸å¦‚8.0

-- ç›‘æ§åŠŸèƒ½é™åˆ¶
-- Performance Schemaè¡¨ä¸å®Œæ•´
-- ç¼ºå°‘è¯¦ç»†çš„å¹¶è¡Œå¤åˆ¶ç»Ÿè®¡ä¿¡æ¯
```

**ğŸ“‹ 5.7ç‰ˆæœ¬ä½¿ç”¨å»ºè®®**
- âœ… **æ¨èä½¿ç”¨**ï¼šDATABASEæ¨¡å¼ï¼Œé€‚ç”¨äºå¤šæ•°æ®åº“ç¯å¢ƒ
- âš ï¸ **è°¨æ…ä½¿ç”¨**ï¼šLOGICAL_CLOCKæ¨¡å¼ï¼Œéœ€è¦å……åˆ†æµ‹è¯•
- âŒ **ä¸å»ºè®®**ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨å®éªŒæ€§åŠŸèƒ½

### 5.2 MySQL 8.0æ”¹è¿›ä¸é™åˆ¶


**ğŸš€ 8.0ç‰ˆæœ¬ä¼˜åŠ¿**
```sql
-- å®Œæ•´çš„å†™é›†æ”¯æŒ
SET GLOBAL binlog_transaction_dependency_tracking = 'WRITESET';
SET GLOBAL binlog_transaction_dependency_history_size = 25000;

-- å¢å¼ºçš„ç›‘æ§èƒ½åŠ›
SELECT * FROM performance_schema.replication_applier_status_by_worker;
```

**ğŸ¯ 8.0ç‰ˆæœ¬æ–°é™åˆ¶**
```
å‘åå…¼å®¹æ€§ï¼š
â”œâ”€â”€ ä¸5.7ä»åº“çš„å…¼å®¹æ€§é—®é¢˜
â”œâ”€â”€ éƒ¨åˆ†å‚æ•°åç§°å˜æ›´
â””â”€â”€ é»˜è®¤å€¼è°ƒæ•´å½±å“

æ–°ç‰¹æ€§é™åˆ¶ï¼š
â”œâ”€â”€ å†™é›†ç®—æ³•CPUå¼€é”€å¢åŠ 
â”œâ”€â”€ å¤§å‹å†™é›†å†…å­˜æ¶ˆè€—
â””â”€â”€ å¤æ‚äº‹åŠ¡çš„ä¾èµ–æ£€æµ‹æˆæœ¬
```

### 5.3 å‡çº§æ³¨æ„äº‹é¡¹


**ğŸ“ å‡çº§æ£€æŸ¥æ¸…å•**
- [ ] **ç‰ˆæœ¬å…¼å®¹æ€§éªŒè¯**ï¼šç¡®è®¤ä¸»ä»ç‰ˆæœ¬åŒ¹é…
- [ ] **å‚æ•°é…ç½®è¿ç§»**ï¼šæ›´æ–°è¿‡æ—¶çš„å‚æ•°è®¾ç½®
- [ ] **æ€§èƒ½åŸºçº¿æµ‹è¯•**ï¼šå¯¹æ¯”å‡çº§å‰åæ€§èƒ½
- [ ] **å›æ»šæ–¹æ¡ˆå‡†å¤‡**ï¼šåˆ¶å®šåº”æ€¥å›é€€ç­–ç•¥

---

## 6. ğŸ”— å¤–é”®çº¦æŸçš„å½±å“


### 6.1 å¤–é”®ä¸å¹¶è¡Œå¤åˆ¶çš„å†²çª


**ğŸ”¸ å¤–é”®çº¦æŸåŸç†**
```sql
-- å¤–é”®å…³ç³»ç¤ºä¾‹
CREATE TABLE customers (
    id INT PRIMARY KEY,
    name VARCHAR(100)
);

CREATE TABLE orders (
    id INT PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);
```

**ğŸ’¡ å…³é”®æ´å¯Ÿ**
> å¤–é”®çº¦æŸè¦æ±‚ä¸¥æ ¼çš„æ“ä½œé¡ºåºï¼šå¿…é¡»å…ˆæœ‰çˆ¶è¡¨è®°å½•ï¼Œæ‰èƒ½æ’å…¥å­è¡¨è®°å½•ã€‚è¿™ç§ä¾èµ–å…³ç³»ä¸å¹¶è¡Œå¤åˆ¶çš„"ä¹±åºæ‰§è¡Œ"å¤©ç„¶å†²çªã€‚

### 6.2 å¤–é”®å¯¼è‡´çš„å¹¶è¡Œå¤åˆ¶é—®é¢˜


**ğŸš¨ å…¸å‹é—®é¢˜åœºæ™¯**
```sql
-- ä¸»åº“æ‰§è¡Œé¡ºåº
INSERT INTO customers (id, name) VALUES (1, 'å¼ ä¸‰');    -- äº‹åŠ¡1
INSERT INTO orders (id, customer_id) VALUES (1, 1);    -- äº‹åŠ¡2

-- ä»åº“å¹¶è¡Œæ‰§è¡Œå¯èƒ½çš„é”™è¯¯é¡ºåº
-- çº¿ç¨‹1æ‰§è¡Œï¼šINSERT INTO orders... (å¤±è´¥ï¼Œå¤–é”®çº¦æŸ)
-- çº¿ç¨‹2æ‰§è¡Œï¼šINSERT INTO customers... (æˆåŠŸ)
-- ç»“æœï¼šå¤åˆ¶ä¸­æ–­ï¼Œé”™è¯¯1452
```

**ğŸ”§ é”™è¯¯è¯Šæ–­æ–¹æ³•**
```sql
-- æŸ¥çœ‹å¤–é”®çº¦æŸé”™è¯¯
SHOW SLAVE STATUS\G
-- Last_SQL_Error: Error 'Cannot add or update a child row: 
-- a foreign key constraint fails...'

-- æ£€æŸ¥å¤–é”®å…³ç³»
SELECT * FROM information_schema.REFERENTIAL_CONSTRAINTS 
WHERE CONSTRAINT_SCHEMA = 'your_database';
```

### 6.3 å¤–é”®ç¯å¢ƒä¸‹çš„è§£å†³ç­–ç•¥


**ğŸ¯ ç­–ç•¥ä¸€ï¼šè°ƒæ•´å¹¶è¡Œæ¨¡å¼**
```sql
-- ä½¿ç”¨æ›´ä¿å®ˆçš„å¹¶è¡Œæ¨¡å¼
SET GLOBAL slave_parallel_type = 'DATABASE';
-- ç¡®ä¿åŒä¸€æ•°æ®åº“å†…çš„äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œ
```

**ğŸ¯ ç­–ç•¥äºŒï¼šå¤–é”®æ£€æŸ¥ä¼˜åŒ–**
```sql
-- ä¸´æ—¶ç¦ç”¨å¤–é”®æ£€æŸ¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
SET FOREIGN_KEY_CHECKS = 0;
-- æ‰§è¡Œå¤åˆ¶æ¢å¤æ“ä½œ
-- é‡æ–°å¯ç”¨æ£€æŸ¥
SET FOREIGN_KEY_CHECKS = 1;
```

**ğŸ¯ ç­–ç•¥ä¸‰ï¼šåº”ç”¨å±‚è®¾è®¡è°ƒæ•´**
```sql
-- é‡æ–°è®¾è®¡æ•°æ®å…³ç³»ï¼Œå‡å°‘å¤–é”®ä¾èµ–
-- ä½¿ç”¨åº”ç”¨å±‚çº¦æŸä»£æ›¿æ•°æ®åº“å¤–é”®
-- é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹
```

---

## 7. âš¡ è§¦å‘å™¨å…¼å®¹æ€§é—®é¢˜


### 7.1 è§¦å‘å™¨ä¸å¹¶è¡Œå¤åˆ¶çš„äº¤äº’


**ğŸ”¸ è§¦å‘å™¨æ‰§è¡Œæœºåˆ¶**
```sql
-- è§¦å‘å™¨ç¤ºä¾‹
CREATE TRIGGER user_audit_trigger
    AFTER UPDATE ON users
    FOR EACH ROW
BEGIN
    INSERT INTO user_audit_log (
        user_id, 
        old_email, 
        new_email, 
        changed_at
    ) VALUES (
        NEW.id, 
        OLD.email, 
        NEW.email, 
        NOW()
    );
END;
```

**âš ï¸ å¹¶è¡Œå¤åˆ¶ä¸­çš„é—®é¢˜**
```
è§¦å‘å™¨æ‰§è¡Œé—®é¢˜ï¼š
â”œâ”€â”€ æ‰§è¡Œé¡ºåºä¸ç¡®å®šæ€§
â”œâ”€â”€ è§¦å‘å™¨é—´çš„ä¾èµ–å…³ç³»
â”œâ”€â”€ ç³»ç»Ÿå˜é‡çŠ¶æ€ä¸ä¸€è‡´
â””â”€â”€ æ—¶é—´å‡½æ•°ç»“æœå·®å¼‚
```

### 7.2 è§¦å‘å™¨å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´


**ğŸ” æ·±å…¥æ€è€ƒ**
> åœ¨ä¸»åº“ä¸Šï¼Œè§¦å‘å™¨æŒ‰ç…§ä¸¥æ ¼çš„äº‹åŠ¡é¡ºåºæ‰§è¡Œï¼Œä½†åœ¨ä»åº“å¹¶è¡Œå¤åˆ¶æ—¶ï¼Œè§¦å‘å™¨çš„æ‰§è¡Œé¡ºåºå¯èƒ½è¢«æ‰“ä¹±ï¼Œå¯¼è‡´å®¡è®¡æ—¥å¿—ã€ç»Ÿè®¡æ•°æ®ç­‰å‡ºç°ä¸ä¸€è‡´ã€‚

**ğŸš¨ å…¸å‹æ¡ˆä¾‹**
```sql
-- ä¸»åº“æ‰§è¡Œ
UPDATE users SET email = 'new1@example.com' WHERE id = 1;  -- è§¦å‘å™¨è®°å½•æ—¶é—´T1
UPDATE users SET email = 'new2@example.com' WHERE id = 2;  -- è§¦å‘å™¨è®°å½•æ—¶é—´T2

-- ä»åº“å¹¶è¡Œæ‰§è¡Œ
-- çº¿ç¨‹1: UPDATE id=2 (è§¦å‘å™¨è®°å½•æ—¶é—´T1')
-- çº¿ç¨‹2: UPDATE id=1 (è§¦å‘å™¨è®°å½•æ—¶é—´T2')
-- ç»“æœï¼šaudit_logä¸­çš„æ—¶é—´é¡ºåºä¸ä¸»åº“ä¸ä¸€è‡´
```

### 7.3 è§¦å‘å™¨ä¼˜åŒ–ç­–ç•¥


**ğŸ“‹ æœ€ä½³å®è·µ**
```sql
-- 1. é¿å…åœ¨è§¦å‘å™¨ä¸­ä½¿ç”¨æ—¶é—´å‡½æ•°
-- ä¸æ¨è
INSERT INTO audit_log (action_time) VALUES (NOW());

-- æ¨èï¼šè®°å½•åŸå§‹äº‹åŠ¡çš„æ—¶é—´
INSERT INTO audit_log (action_time) VALUES (@original_timestamp);
```

**ğŸ”§ é…ç½®ä¼˜åŒ–**
```sql
-- 2. è®¾ç½®ç¡®å®šæ€§çš„ç³»ç»Ÿå˜é‡
SET GLOBAL log_slave_updates = ON;
SET GLOBAL slave_preserve_commit_order = ON;  -- MySQL 5.7+
```

---

## 8. ğŸ“¦ å¤§äº‹åŠ¡æ€§èƒ½å½±å“


### 8.1 å¤§äº‹åŠ¡çš„å®šä¹‰å’Œè¯†åˆ«


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¤§äº‹åŠ¡**
```
å¤§äº‹åŠ¡åˆ¤æ–­æ ‡å‡†ï¼š
â”œâ”€â”€ ä¿®æ”¹è¡Œæ•°ï¼š>10ä¸‡è¡Œ
â”œâ”€â”€ äº‹åŠ¡å¤§å°ï¼š>100MB
â”œâ”€â”€ æ‰§è¡Œæ—¶é—´ï¼š>30ç§’
â””â”€â”€ é”å®šèµ„æºï¼š>1000ä¸ªè¡¨æˆ–ç´¢å¼•
```

**ğŸ” å¤§äº‹åŠ¡è¯†åˆ«æ–¹æ³•**
```sql
-- ç›‘æ§æ­£åœ¨æ‰§è¡Œçš„å¤§äº‹åŠ¡
SELECT 
    trx_id,
    trx_rows_modified,
    trx_lock_memory_bytes,
    TIMESTAMPDIFF(SECOND, trx_started, NOW()) as duration_seconds
FROM information_schema.INNODB_TRX
WHERE trx_rows_modified > 100000 
   OR TIMESTAMPDIFF(SECOND, trx_started, NOW()) > 30;
```

### 8.2 å¤§äº‹åŠ¡å¯¹å¹¶è¡Œå¤åˆ¶çš„å½±å“


**ğŸ“Š æ€§èƒ½å½±å“åˆ†æ**
```
å½±å“ç»´åº¦                     å…·ä½“è¡¨ç°
â”œâ”€â”€ å†…å­˜æ¶ˆè€— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ binlogç¼“å­˜æš´å¢ï¼Œå·¥ä½œçº¿ç¨‹å†…å­˜ä¸è¶³
â”œâ”€â”€ ç½‘ç»œä¼ è¾“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¤§é‡æ•°æ®ä¼ è¾“é˜»å¡å…¶ä»–äº‹åŠ¡
â”œâ”€â”€ ç£ç›˜IO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¤§é‡éšæœºå†™å…¥ï¼Œå½±å“æ•´ä½“æ€§èƒ½
â”œâ”€â”€ é”ç«äº‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é•¿æ—¶é—´æŒé”ï¼Œé˜»å¡å…¶ä»–å¹¶è¡Œçº¿ç¨‹
â””â”€â”€ å¤åˆ¶å»¶è¿Ÿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å•ä¸ªäº‹åŠ¡æ‰§è¡Œæ—¶é—´é•¿ï¼Œå»¶è¿Ÿç´¯ç§¯
```

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> å¤§äº‹åŠ¡å°±åƒé«˜é€Ÿå…¬è·¯ä¸Šçš„è¶…é•¿è´§è½¦ï¼Œè™½ç„¶åªæœ‰ä¸€è¾†ï¼Œä½†ä¼šå ç”¨å¤šä¸ªè½¦é“ï¼Œå½±å“å…¶ä»–è½¦è¾†çš„æ­£å¸¸é€šè¡Œï¼Œæœ€ç»ˆå¯¼è‡´æ•´æ¡é«˜é€Ÿå…¬è·¯çš„é€šè¡Œæ•ˆç‡ä¸‹é™ã€‚

### 8.3 å¤§äº‹åŠ¡ä¼˜åŒ–ç­–ç•¥


**ğŸ¯ æ‹†åˆ†ç­–ç•¥**
```sql
-- ä¸æ¨èï¼šä¸€ä¸ªå¤§äº‹åŠ¡
BEGIN;
UPDATE products SET price = price * 1.1;  -- å½±å“100ä¸‡è¡Œ
COMMIT;

-- æ¨èï¼šåˆ†æ‰¹å¤„ç†
DELIMITER $$
CREATE PROCEDURE batch_update_prices()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE batch_size INT DEFAULT 10000;
    
    REPEAT
        UPDATE products SET price = price * 1.1 
        WHERE price_updated = 0 
        LIMIT batch_size;
        
        UPDATE products SET price_updated = 1 
        WHERE price_updated = 0 AND updated_at > NOW() - INTERVAL 1 SECOND;
        
        -- çŸ­æš‚ä¼‘æ¯ï¼Œé‡Šæ”¾é”
        DO SLEEP(0.1);
    UNTIL ROW_COUNT() = 0 END REPEAT;
END$$
DELIMITER ;
```

**âš¡ æ€§èƒ½ç›‘æ§**
```sql
-- ç›‘æ§å¤åˆ¶å»¶è¿Ÿ
SHOW SLAVE STATUS\G

-- æŸ¥çœ‹å¹¶è¡Œå·¥ä½œçº¿ç¨‹çŠ¶æ€
SELECT 
    WORKER_ID,
    SERVICE_STATE,
    LAST_ERROR_MESSAGE
FROM performance_schema.replication_applier_status_by_worker;
```

---

## 9. ğŸ› ï¸ é™åˆ¶æ£€æµ‹ä¸è§„é¿ç­–ç•¥


### 9.1 åŠ¨æ€é™åˆ¶æ£€æµ‹æœºåˆ¶


**ğŸ” è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿ**
```sql
-- åˆ›å»ºé™åˆ¶æ£€æµ‹å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE check_parallel_replication_limits()
BEGIN
    DECLARE myisam_tables INT DEFAULT 0;
    DECLARE foreign_keys INT DEFAULT 0;
    DECLARE triggers INT DEFAULT 0;
    DECLARE large_transactions INT DEFAULT 0;
    
    -- æ£€æµ‹MyISAMè¡¨
    SELECT COUNT(*) INTO myisam_tables
    FROM information_schema.TABLES
    WHERE ENGINE = 'MyISAM' AND TABLE_SCHEMA NOT IN ('mysql', 'sys');
    
    -- æ£€æµ‹å¤–é”®çº¦æŸ
    SELECT COUNT(*) INTO foreign_keys
    FROM information_schema.REFERENTIAL_CONSTRAINTS
    WHERE CONSTRAINT_SCHEMA NOT IN ('mysql', 'sys');
    
    -- æ£€æµ‹è§¦å‘å™¨
    SELECT COUNT(*) INTO triggers
    FROM information_schema.TRIGGERS
    WHERE TRIGGER_SCHEMA NOT IN ('mysql', 'sys');
    
    -- è¾“å‡ºæ£€æµ‹ç»“æœ
    SELECT 
        CASE WHEN myisam_tables > 0 THEN 'WARNING: MyISAM tables detected' 
             ELSE 'OK: No MyISAM tables' END as myisam_check,
        CASE WHEN foreign_keys > 0 THEN 'CAUTION: Foreign keys exist' 
             ELSE 'OK: No foreign keys' END as fk_check,
        CASE WHEN triggers > 0 THEN 'CAUTION: Triggers exist' 
             ELSE 'OK: No triggers' END as trigger_check;
END$$
DELIMITER ;

-- æ‰§è¡Œæ£€æµ‹
CALL check_parallel_replication_limits();
```

### 9.2 é¢„é˜²æ€§é…ç½®ç­–ç•¥


**ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•**
- [ ] **å­˜å‚¨å¼•æ“æ£€æŸ¥**ï¼šç¡®ä¿ä¸»è¦è¡¨ä½¿ç”¨InnoDB
- [ ] **å¤–é”®å…³ç³»æ¢³ç†**ï¼šæ–‡æ¡£åŒ–æ‰€æœ‰å¤–é”®ä¾èµ–
- [ ] **è§¦å‘å™¨å®¡è®¡**ï¼šæ£€æŸ¥è§¦å‘å™¨çš„å¿…è¦æ€§
- [ ] **å¤§äº‹åŠ¡ç›‘æ§**ï¼šå»ºç«‹å¤§äº‹åŠ¡é¢„è­¦æœºåˆ¶

**ğŸ”§ è‡ªåŠ¨åŒ–é…ç½®è„šæœ¬**
```bash
#!/bin/bash
# å¹¶è¡Œå¤åˆ¶ç¯å¢ƒæ£€æŸ¥è„šæœ¬

echo "=== MySQLå¹¶è¡Œå¤åˆ¶ç¯å¢ƒæ£€æŸ¥ ==="

# 1. æ£€æŸ¥MySQLç‰ˆæœ¬
mysql_version=$(mysql -V | grep -oP '\d+\.\d+' | head -1)
echo "MySQLç‰ˆæœ¬: $mysql_version"

if [[ $(echo "$mysql_version >= 5.7" | bc) -eq 1 ]]; then
    echo "âœ… ç‰ˆæœ¬æ”¯æŒå¹¶è¡Œå¤åˆ¶"
else
    echo "âŒ ç‰ˆæœ¬è¿‡ä½ï¼Œä¸æ”¯æŒå¹¶è¡Œå¤åˆ¶"
    exit 1
fi

# 2. æ£€æŸ¥å½“å‰é…ç½®
echo "å½“å‰å¹¶è¡Œå¤åˆ¶é…ç½®ï¼š"
mysql -e "SHOW VARIABLES LIKE '%slave_parallel%';"

# 3. æ£€æŸ¥å¤åˆ¶çŠ¶æ€
mysql -e "SHOW SLAVE STATUS\G" | grep -E "(Slave_IO_Running|Slave_SQL_Running|Seconds_Behind_Master)"

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

### 9.3 é™åˆ¶è§„é¿è‡ªåŠ¨åŒ–ç­–ç•¥


**ğŸš€ æ™ºèƒ½é€‚é…æœºåˆ¶**
```sql
-- åˆ›å»ºè‡ªé€‚åº”é…ç½®è°ƒæ•´åŠŸèƒ½
DELIMITER $$
CREATE PROCEDURE auto_adjust_parallel_config()
BEGIN
    DECLARE current_delay INT DEFAULT 0;
    DECLARE error_count INT DEFAULT 0;
    DECLARE current_workers INT DEFAULT 0;
    
    -- è·å–å½“å‰çŠ¶æ€
    SELECT VARIABLE_VALUE INTO current_workers 
    FROM performance_schema.global_variables 
    WHERE VARIABLE_NAME = 'slave_parallel_workers';
    
    -- æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
    SELECT TIME_TO_SEC(time_lag) INTO current_delay
    FROM performance_schema.replication_connection_status;
    
    -- æ ¹æ®å»¶è¿Ÿæƒ…å†µè‡ªåŠ¨è°ƒæ•´
    IF current_delay > 60 AND current_workers < 8 THEN
        -- å»¶è¿Ÿè¾ƒå¤§ï¼Œå¢åŠ å¹¶è¡Œåº¦
        SET GLOBAL slave_parallel_workers = current_workers + 2;
        INSERT INTO replication_adjustment_log VALUES 
            (NOW(), 'Increased workers due to lag', current_workers, current_workers + 2);
            
    ELSEIF current_delay < 10 AND current_workers > 2 THEN
        -- å»¶è¿Ÿå¾ˆå°ï¼Œå¯ä»¥å‡å°‘èµ„æºä½¿ç”¨
        SET GLOBAL slave_parallel_workers = current_workers - 1;
        INSERT INTO replication_adjustment_log VALUES 
            (NOW(), 'Decreased workers due to low lag', current_workers, current_workers - 1);
    END IF;
END$$
DELIMITER ;

-- åˆ›å»ºå®šæ—¶ä»»åŠ¡
CREATE EVENT auto_parallel_tuning
ON SCHEDULE EVERY 5 MINUTE
DO CALL auto_adjust_parallel_config();
```

### 9.4 å…¼å®¹æ€§é—®é¢˜é¢„æµ‹ä¸é¢„é˜²


**ğŸ”® é¢„æµ‹æ€§åˆ†æ**
```sql
-- å…¼å®¹æ€§é£é™©è¯„ä¼°æŸ¥è¯¢
SELECT 
    'Storage Engine Risk' as risk_type,
    TABLE_SCHEMA,
    ENGINE,
    COUNT(*) as table_count,
    CASE 
        WHEN ENGINE = 'MyISAM' THEN 'HIGH'
        WHEN ENGINE = 'MEMORY' THEN 'MEDIUM'
        ELSE 'LOW'
    END as risk_level
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA NOT IN ('mysql', 'sys', 'performance_schema', 'information_schema')
GROUP BY TABLE_SCHEMA, ENGINE

UNION ALL

SELECT 
    'Foreign Key Risk' as risk_type,
    CONSTRAINT_SCHEMA,
    'Foreign Keys',
    COUNT(*),
    CASE 
        WHEN COUNT(*) > 50 THEN 'HIGH'
        WHEN COUNT(*) > 10 THEN 'MEDIUM'
        ELSE 'LOW'
    END
FROM information_schema.REFERENTIAL_CONSTRAINTS
GROUP BY CONSTRAINT_SCHEMA;
```

**ğŸ“Š é£é™©è¯„ä¼°æŠ¥å‘Š**
```
é£é™©ç­‰çº§è¯„ä¼°æ ‡å‡†ï¼š

ğŸ”´ HIGHé£é™©ï¼š
â”œâ”€â”€ MyISAMè¡¨è¶…è¿‡10ä¸ª
â”œâ”€â”€ å¤–é”®å…³ç³»è¶…è¿‡50ä¸ª
â”œâ”€â”€ å­˜åœ¨å¤§é‡è§¦å‘å™¨
â””â”€â”€ é¢‘ç¹çš„DDLæ“ä½œ

ğŸŸ¡ MEDIUMé£é™©ï¼š
â”œâ”€â”€ å°‘é‡MyISAMè¡¨
â”œâ”€â”€ ç®€å•å¤–é”®å…³ç³»
â”œâ”€â”€ å¶å‘å¤§äº‹åŠ¡
â””â”€â”€ ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜

ğŸŸ¢ LOWé£é™©ï¼š
â”œâ”€â”€ çº¯InnoDBç¯å¢ƒ
â”œâ”€â”€ æ— å¤æ‚çº¦æŸ
â”œâ”€â”€ äº‹åŠ¡å¤§å°åˆç†
â””â”€â”€ ç‰ˆæœ¬å®Œå…¨å…¼å®¹
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒé™åˆ¶


```
ğŸ”¸ å­˜å‚¨å¼•æ“é™åˆ¶ï¼šMyISAMç­‰éäº‹åŠ¡å¼•æ“ä¸é€‚åˆå¹¶è¡Œå¤åˆ¶
ğŸ”¸ å¤–é”®çº¦æŸå½±å“ï¼šä¸¥æ ¼çš„ä¾èµ–å…³ç³»é™åˆ¶å¹¶è¡Œæ‰§è¡Œ
ğŸ”¸ è§¦å‘å™¨å…¼å®¹æ€§ï¼šå¹¶è¡Œæ‰§è¡Œå¯èƒ½å¯¼è‡´è§¦å‘å™¨ç»“æœä¸ä¸€è‡´
ğŸ”¸ å¤§äº‹åŠ¡æ€§èƒ½ï¼šå•ä¸ªå¤§äº‹åŠ¡ä¼šé˜»å¡å¹¶è¡Œå¤åˆ¶æ•ˆæœ
ğŸ”¸ ç‰ˆæœ¬å·®å¼‚é™åˆ¶ï¼šä¸åŒç‰ˆæœ¬é—´çš„å…¼å®¹æ€§é—®é¢˜
ğŸ”¸ DDLæ“ä½œé™åˆ¶ï¼šç»“æ„å˜æ›´æ“ä½œé€šå¸¸æ— æ³•å¹¶è¡Œ
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆå­˜åœ¨è¿™äº›é™åˆ¶**
```
æŠ€æœ¯æœ¬è´¨ï¼š
- æ•°æ®ä¸€è‡´æ€§æ˜¯ç¬¬ä¸€è¦åŠ¡ï¼Œæ€§èƒ½æ˜¯ç¬¬äºŒè¦åŠ¡
- å¹¶è¡Œæ‰§è¡Œä¸é¡ºåºä¾èµ–å¤©ç„¶å†²çª
- å…¼å®¹æ€§è€ƒè™‘é™åˆ¶äº†æ¿€è¿›ä¼˜åŒ–

è®¾è®¡æƒè¡¡ï¼š
- å®‰å…¨æ€§ vs æ€§èƒ½
- å…¼å®¹æ€§ vs æ–°ç‰¹æ€§  
- å¤æ‚åº¦ vs æ˜“ç”¨æ€§
```

**ğŸ”¹ å¦‚ä½•æ­£ç¡®åº”å¯¹é™åˆ¶**
```
è¯†åˆ«é™åˆ¶ï¼š
- ä½¿ç”¨è‡ªåŠ¨åŒ–æ£€æµ‹å·¥å…·
- å»ºç«‹å®Œæ•´çš„ç¯å¢ƒè¯„ä¼°
- å®šæœŸå®¡æŸ¥é…ç½®åˆç†æ€§

è§„é¿ç­–ç•¥ï¼š
- ä¼˜åŒ–æ•°æ®åº“è®¾è®¡å‡å°‘ä¾èµ–
- è°ƒæ•´å¹¶è¡Œå¤åˆ¶å‚æ•°
- ä½¿ç”¨åˆ†æ‰¹å¤„ç†ä»£æ›¿å¤§äº‹åŠ¡

ç›‘æ§æªæ–½ï¼š
- å®æ—¶ç›‘æ§å¤åˆ¶çŠ¶æ€
- å»ºç«‹æ€§èƒ½åŸºçº¿å¯¹æ¯”
- è®¾ç½®å‘Šè­¦é˜ˆå€¼
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**
```
éƒ¨ç½²å‰æ£€æŸ¥ï¼š
âœ… æ‰§è¡Œå…¼å®¹æ€§è¯„ä¼°è„šæœ¬
âœ… æ¢³ç†æ‰€æœ‰å¤–é”®å’Œè§¦å‘å™¨å…³ç³»
âœ… åˆ¶å®šå¤§äº‹åŠ¡å¤„ç†ç­–ç•¥
âœ… å‡†å¤‡å›æ»šå’Œåº”æ€¥æ–¹æ¡ˆ

è¿è¡Œæ—¶ç›‘æ§ï¼š
âœ… æŒç»­ç›‘æ§å¤åˆ¶å»¶è¿Ÿ
âœ… è·Ÿè¸ªå¹¶è¡Œå·¥ä½œçº¿ç¨‹çŠ¶æ€
âœ… è®°å½•æ€§èƒ½æŒ‡æ ‡å˜åŒ–
âœ… å®šæœŸæ£€æŸ¥é”™è¯¯æ—¥å¿—

ä¼˜åŒ–ç­–ç•¥ï¼š
âœ… æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å¹¶è¡Œæ¨¡å¼
âœ… åŠ¨æ€è°ƒæ•´å·¥ä½œçº¿ç¨‹æ•°é‡
âœ… ä¼˜åŒ–ç½‘ç»œå’Œç¡¬ä»¶é…ç½®
âœ… å»ºç«‹è‡ªåŠ¨åŒ–è¿ç»´æµç¨‹
```

**ğŸ’ª å®è·µæŒ‘æˆ˜**
å°è¯•åœ¨ä½ çš„ç¯å¢ƒä¸­ï¼š
1. è¿è¡Œé™åˆ¶æ£€æµ‹è„šæœ¬ï¼Œè¯†åˆ«æ½œåœ¨é—®é¢˜
2. è®¾è®¡ä¸€ä¸ªå¤§äº‹åŠ¡æ‹†åˆ†æ–¹æ¡ˆ
3. å»ºç«‹å¹¶è¡Œå¤åˆ¶æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿
4. åˆ¶å®šä¸åŒåœºæ™¯ä¸‹çš„åº”å¯¹ç­–ç•¥

**ğŸ¯ ä¸€åˆ†é’ŸæŒæ¡**
å¹¶è¡Œå¤åˆ¶é™åˆ¶çš„æ ¸å¿ƒè¦ç‚¹ï¼š
1. **è¯†åˆ«é™åˆ¶**ï¼šMyISAMã€å¤–é”®ã€è§¦å‘å™¨ã€å¤§äº‹åŠ¡
2. **è¯„ä¼°å½±å“**ï¼šæ€§èƒ½ä¸‹é™ã€æ•°æ®ä¸ä¸€è‡´ã€å…¼å®¹æ€§é—®é¢˜  
3. **åˆ¶å®šç­–ç•¥**ï¼šæ£€æµ‹ã€é¢„é˜²ã€ç›‘æ§ã€ä¼˜åŒ–

**â­ å¿…é¡»ç†è§£**
å¹¶è¡Œå¤åˆ¶ä¸æ˜¯ä¸‡èƒ½çš„æ€§èƒ½æå‡æ–¹æ¡ˆï¼Œéœ€è¦åœ¨æ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ã€‚æ­£ç¡®è¯†åˆ«å’Œåº”å¯¹é™åˆ¶ï¼Œæ˜¯æˆåŠŸå®æ–½å¹¶è¡Œå¤åˆ¶çš„å…³é”®ã€‚

**ğŸš¨ å…³é”®è®°å¿†**
> å¹¶è¡Œå¤åˆ¶é™åˆ¶å¤šï¼Œè¯†åˆ«è§„é¿æ˜¯å…³é”®
> å­˜å‚¨å¼•æ“è¦é€‰å¯¹ï¼Œå¤–é”®è§¦å‘è¦å°å¿ƒ  
> å¤§äº‹åŠ¡å½±å“å¤§ï¼Œç‰ˆæœ¬å…¼å®¹éœ€æ³¨æ„
> ç›‘æ§é¢„è­¦ä¸å¯å°‘ï¼Œæ€§èƒ½å®‰å…¨ä¸¤æ‰‹æŠ“

---

> ğŸ“š **æ‰©å±•é˜…è¯»**
> - ğŸ“– æ·±å…¥å­¦ä¹ ï¼š[MySQLå®˜æ–¹å¹¶è¡Œå¤åˆ¶æ–‡æ¡£](https://dev.mysql.com/doc/)
> - ğŸ¥ å®æˆ˜æ¡ˆä¾‹ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹çš„å¤åˆ¶ä¼˜åŒ–å®è·µ
> - ğŸ’» å·¥å…·æ¨èï¼šPercona Toolkitå¹¶è¡Œå¤åˆ¶åˆ†æå·¥å…·