---
title: 17ã€MGRæœ€ä½³å®è·µä¸è°ƒä¼˜
---
## ğŸ“š ç›®å½•

1. [MGRæ¶æ„è®¾è®¡æœ€ä½³å®è·µ](#1-MGRæ¶æ„è®¾è®¡æœ€ä½³å®è·µ)
2. [å…³é”®å‚æ•°é…ç½®ä¸è°ƒä¼˜](#2-å…³é”®å‚æ•°é…ç½®ä¸è°ƒä¼˜)
3. [æ€§èƒ½è°ƒä¼˜å…¨é¢æŒ‡å—](#3-æ€§èƒ½è°ƒä¼˜å…¨é¢æŒ‡å—)
4. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è§„èŒƒ](#4-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è§„èŒƒ)
5. [è¿ç»´è‡ªåŠ¨åŒ–ä¸ç›‘æ§](#5-è¿ç»´è‡ªåŠ¨åŒ–ä¸ç›‘æ§)
6. [æ•…éšœé¢„é˜²ä¸å®¹é‡è§„åˆ’](#6-æ•…éšœé¢„é˜²ä¸å®¹é‡è§„åˆ’)
7. [äº‘åŸç”Ÿç¯å¢ƒä¼˜åŒ–ç­–ç•¥](#7-äº‘åŸç”Ÿç¯å¢ƒä¼˜åŒ–ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ MGRæ¶æ„è®¾è®¡æœ€ä½³å®è·µ


### 1.1 ä»€ä¹ˆæ˜¯MGRæ¶æ„è®¾è®¡


**MGRï¼ˆMySQL Group Replicationï¼‰** æ˜¯MySQLå®˜æ–¹æä¾›çš„é«˜å¯ç”¨é›†ç¾¤è§£å†³æ–¹æ¡ˆã€‚ç®€å•æ¥è¯´ï¼ŒMGRå°±åƒæ˜¯æŠŠå¤šä¸ªMySQLæ•°æ®åº“"ç»„å›¢"å·¥ä½œï¼Œå½“å…¶ä¸­ä¸€ä¸ªå‡ºé—®é¢˜æ—¶ï¼Œå…¶ä»–æˆå‘˜å¯ä»¥ç«‹å³æ¥æ›¿å·¥ä½œï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¸­æ–­ã€‚

```
ä¼ ç»ŸMySQLæ¶æ„ï¼š
ä¸»åº“ -----> ä»åº“1
     -----> ä»åº“2
     -----> ä»åº“3
é—®é¢˜ï¼šä¸»åº“æŒ‚äº†ï¼Œéœ€è¦äººå·¥åˆ‡æ¢

MGRæ¶æ„ï¼š
èŠ‚ç‚¹1 â†---â†’ èŠ‚ç‚¹2
  â†•         â†•
èŠ‚ç‚¹3 â†---â†’ èŠ‚ç‚¹4
ä¼˜åŠ¿ï¼šè‡ªåŠ¨æ•…éšœåˆ‡æ¢ï¼Œæ— éœ€äººå·¥å¹²é¢„
```

### 1.2 é›†ç¾¤è§„æ¨¡è§„åˆ’æŒ‡å—


**ğŸ¯ è§„æ¨¡é€‰æ‹©åŸåˆ™**

```
å°å‹ä¸šåŠ¡ï¼ˆå¹¶å‘ < 1000ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹1  â”‚  èŠ‚ç‚¹2  â”‚  èŠ‚ç‚¹3  â”‚
â”‚ (ä¸»è¯»å†™) â”‚ (å¤‡ç”¨)  â”‚ (å¤‡ç”¨)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€¢ é…ç½®ï¼š3èŠ‚ç‚¹æœ€å°é›†ç¾¤
â€¢ èµ„æºï¼šæ¯èŠ‚ç‚¹4C8Gèµ·æ­¥
â€¢ ç½‘ç»œï¼šåƒå…†ä»¥å¤ªç½‘å³å¯

ä¸­å‹ä¸šåŠ¡ï¼ˆå¹¶å‘ 1000-5000ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹1  â”‚  èŠ‚ç‚¹2  â”‚  èŠ‚ç‚¹3  â”‚  èŠ‚ç‚¹4  â”‚  èŠ‚ç‚¹5  â”‚
â”‚ (ä¸»è¯»å†™) â”‚ (è¯»è´Ÿè½½) â”‚ (è¯»è´Ÿè½½) â”‚ (å¤‡ç”¨)  â”‚ (ä»²è£)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€¢ é…ç½®ï¼š5èŠ‚ç‚¹æ‰©å±•é›†ç¾¤
â€¢ èµ„æºï¼šæ¯èŠ‚ç‚¹8C16Gèµ·æ­¥
â€¢ ç½‘ç»œï¼šä¸‡å…†ä»¥å¤ªç½‘æ¨è

å¤§å‹ä¸šåŠ¡ï¼ˆå¹¶å‘ > 5000ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            è´Ÿè½½å‡è¡¡å™¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MGRé›†ç¾¤1â”‚ â”‚ MGRé›†ç¾¤2â”‚ â”‚ MGRé›†ç¾¤3â”‚
    â”‚ (å†™å…¥) â”‚ â”‚ (è¯»å–) â”‚ â”‚ (åˆ†æ) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
â€¢ é…ç½®ï¼šå¤šé›†ç¾¤æ¶æ„
â€¢ èµ„æºï¼šæ¯èŠ‚ç‚¹16C32Gä»¥ä¸Š
â€¢ ç½‘ç»œï¼šä¸“ç”¨ç½‘ç»œéš”ç¦»
```

### 1.3 æ¶æ„è®¾è®¡æ ¸å¿ƒåŸåˆ™


**ğŸ”¸ å¥‡æ•°èŠ‚ç‚¹åŸåˆ™**
```
ä¸ºä»€ä¹ˆè¦å¥‡æ•°èŠ‚ç‚¹ï¼Ÿ
åœºæ™¯ï¼šç½‘ç»œåˆ†åŒºå¯¼è‡´é›†ç¾¤è¢«åˆ†å‰²æˆä¸¤éƒ¨åˆ†

å¶æ•°èŠ‚ç‚¹é—®é¢˜ï¼š
é›†ç¾¤A: èŠ‚ç‚¹1, èŠ‚ç‚¹2 (2ç¥¨)
é›†ç¾¤B: èŠ‚ç‚¹3, èŠ‚ç‚¹4 (2ç¥¨)
ç»“æœï¼šç¥¨æ•°ç›¸ç­‰ï¼Œæ— æ³•ç¡®å®šè°æ˜¯ä¸»é›†ç¾¤

å¥‡æ•°èŠ‚ç‚¹è§£å†³ï¼š
é›†ç¾¤A: èŠ‚ç‚¹1, èŠ‚ç‚¹2, èŠ‚ç‚¹3 (3ç¥¨)
é›†ç¾¤B: èŠ‚ç‚¹4, èŠ‚ç‚¹5 (2ç¥¨)  
ç»“æœï¼šé›†ç¾¤Aè·å¾—å¤šæ•°ç¥¨ï¼Œç»§ç»­æä¾›æœåŠ¡
```

**ğŸ”¸ è·¨å¯ç”¨åŒºéƒ¨ç½²**
```
ç”Ÿäº§ç¯å¢ƒæ¨èéƒ¨ç½²æ–¹å¼ï¼š

å¯ç”¨åŒºA        å¯ç”¨åŒºB        å¯ç”¨åŒºC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹1  â”‚   â”‚  èŠ‚ç‚¹2  â”‚   â”‚  èŠ‚ç‚¹3  â”‚
â”‚ (ä¸»èŠ‚ç‚¹) â”‚   â”‚ (å‰¯æœ¬)  â”‚   â”‚ (å‰¯æœ¬)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŠ¿ï¼š
â€¢ å•ä¸ªæœºæˆ¿æ•…éšœä¸å½±å“æœåŠ¡
â€¢ æ»¡è¶³å®¹ç¾è¦æ±‚
â€¢ æé«˜æ•´ä½“å¯ç”¨æ€§
```

---

## 2. âš™ï¸ å…³é”®å‚æ•°é…ç½®ä¸è°ƒä¼˜


### 2.1 MGRæ ¸å¿ƒå‚æ•°è¯¦è§£


**ğŸ”§ åŸºç¡€é…ç½®å‚æ•°**

```ini
# my.cnf æ ¸å¿ƒé…ç½®
[mysqld]
# ===== æœåŠ¡å™¨æ ‡è¯† =====
server-id=1                          # æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†
gtid_mode=ON                        # å¯ç”¨GTIDæ¨¡å¼
enforce_gtid_consistency=ON         # å¼ºåˆ¶GTIDä¸€è‡´æ€§
binlog_format=ROW                   # äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼

# ===== Group Replicationæ ¸å¿ƒå‚æ•° =====
plugin_load_add='group_replication.so'                    # åŠ è½½MGRæ’ä»¶
group_replication_group_name="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"  # é›†ç¾¤å”¯ä¸€æ ‡è¯†
group_replication_start_on_boot=off                       # ç¦ç”¨è‡ªåŠ¨å¯åŠ¨
group_replication_local_address="192.168.1.10:33061"     # æœ¬åœ°é€šä¿¡åœ°å€
group_replication_group_seeds="192.168.1.10:33061,192.168.1.11:33061,192.168.1.12:33061"  # ç§å­èŠ‚ç‚¹åˆ—è¡¨
group_replication_bootstrap_group=off                     # ç¦ç”¨å¼•å¯¼æ¨¡å¼
```

**ğŸ’¡ å‚æ•°å«ä¹‰é€šä¿—è§£é‡Š**

| å‚æ•° | **ä½œç”¨** | **é€šä¿—ç†è§£** |
|------|---------|-------------|
| `server-id` | æœåŠ¡å™¨å”¯ä¸€æ ‡è¯† | å°±åƒèº«ä»½è¯å·ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¸åŒ |
| `gtid_mode` | å…¨å±€äº‹åŠ¡æ ‡è¯† | ç»™æ¯ä¸ªæ•°æ®å˜æ›´æ‰“ä¸Šå”¯ä¸€æ ‡ç­¾ |
| `group_replication_group_name` | é›†ç¾¤ç»„å | ç±»ä¼¼å¾®ä¿¡ç¾¤åï¼ŒåŒä¸€ä¸ªç¾¤çš„æ‰èƒ½é€šä¿¡ |
| `group_replication_local_address` | æœ¬æœºé€šä¿¡åœ°å€ | å‘Šè¯‰å…¶ä»–èŠ‚ç‚¹æˆ‘çš„è”ç³»æ–¹å¼ |
| `group_replication_group_seeds` | ç§å­èŠ‚ç‚¹åˆ—è¡¨ | æ–°èŠ‚ç‚¹åŠ å…¥æ—¶çš„è”ç³»äººåˆ—è¡¨ |

### 2.2 æ€§èƒ½è°ƒä¼˜å…³é”®å‚æ•°


**âš¡ æ€§èƒ½ç›¸å…³é…ç½®**

```ini
# ===== æ€§èƒ½è°ƒä¼˜å‚æ•° =====
group_replication_flow_control_mode=QUOTA              # æµæ§æ¨¡å¼
group_replication_flow_control_certifier_threshold=25000   # è®¤è¯é˜Ÿåˆ—é˜ˆå€¼
group_replication_flow_control_applier_threshold=25000     # åº”ç”¨é˜Ÿåˆ—é˜ˆå€¼

# ===== ç½‘ç»œä¼˜åŒ– =====
group_replication_compression_threshold=1000           # å‹ç¼©é˜ˆå€¼(å­—èŠ‚)
group_replication_communication_max_message_size=10M   # æœ€å¤§æ¶ˆæ¯å¤§å°
group_replication_message_cache_size=1G               # æ¶ˆæ¯ç¼“å­˜å¤§å°

# ===== ä¸€è‡´æ€§è®¾ç½® =====
group_replication_consistency=EVENTUAL                 # ä¸€è‡´æ€§çº§åˆ«
group_replication_single_primary_mode=ON              # å•ä¸»æ¨¡å¼
group_replication_enforce_update_everywhere_checks=OFF # ç¦ç”¨å¤šä¸»æ£€æŸ¥
```

**ğŸ¯ å‚æ•°è°ƒä¼˜å»ºè®®**

```
é«˜å¹¶å‘ç¯å¢ƒè°ƒä¼˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è°ƒä¼˜ç­–ç•¥                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¤è¯é˜Ÿåˆ—é˜ˆå€¼: 50000 (é»˜è®¤25000)      â”‚
â”‚ åº”ç”¨é˜Ÿåˆ—é˜ˆå€¼: 50000 (é»˜è®¤25000)      â”‚
â”‚ æ¶ˆæ¯ç¼“å­˜å¤§å°: 2G (é»˜è®¤1G)           â”‚
â”‚ å‹ç¼©é˜ˆå€¼: 500 (é»˜è®¤1000)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½å»¶è¿Ÿç¯å¢ƒè°ƒä¼˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è°ƒä¼˜ç­–ç•¥                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸€è‡´æ€§çº§åˆ«: BEFORE_ON_PRIMARY_FAILOVER â”‚
â”‚ æµæ§æ¨¡å¼: DISABLED                   â”‚
â”‚ ç½‘ç»œå‹ç¼©: å…³é—­ (è®¾ç½®å¾ˆå¤§çš„é˜ˆå€¼)       â”‚
â”‚ æ¶ˆæ¯å¤§å°: 16M                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸš€ æ€§èƒ½è°ƒä¼˜å…¨é¢æŒ‡å—


### 3.1 æ€§èƒ½è°ƒä¼˜çš„ç†è§£åŸºç¡€


**ä»€ä¹ˆæ˜¯MGRæ€§èƒ½è°ƒä¼˜ï¼Ÿ**
å°±åƒæ±½è½¦éœ€è¦å®šæœŸä¿å…»å’Œè°ƒæ ¡ä¸€æ ·ï¼ŒMGRé›†ç¾¤ä¹Ÿéœ€è¦æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚è°ƒä¼˜çš„ç›®æ ‡æ˜¯è®©é›†ç¾¤è·‘å¾—æ›´å¿«ã€æ›´ç¨³ã€æ›´çœèµ„æºã€‚

```
æ€§èƒ½è°ƒä¼˜çš„ä¸‰ä¸ªç»´åº¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ååé‡                    â”‚ â† æ¯ç§’èƒ½å¤„ç†å¤šå°‘äº‹åŠ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            å»¶è¿Ÿ                     â”‚ â† ä¸€ä¸ªäº‹åŠ¡éœ€è¦å¤šé•¿æ—¶é—´
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           èµ„æºåˆ©ç”¨ç‡                 â”‚ â† CPUã€å†…å­˜ã€ç½‘ç»œä½¿ç”¨æƒ…å†µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ™ºèƒ½åŒ–æ¨èç³»ç»Ÿ


**ğŸ¤– åŸºäºè´Ÿè½½çš„è‡ªåŠ¨è°ƒä¼˜**

```sql
-- æ€§èƒ½ç›‘æ§æŸ¥è¯¢è„šæœ¬
SELECT 
    'MGRæ€§èƒ½æŒ‡æ ‡' as æŒ‡æ ‡ç±»å‹,
    CASE 
        WHEN replication_lag > 5 THEN 'å»¶è¿Ÿè¿‡é«˜ï¼Œå»ºè®®ä¼˜åŒ–ç½‘ç»œ'
        WHEN certification_queue > 30000 THEN 'è®¤è¯é˜Ÿåˆ—ç§¯å‹ï¼Œå»ºè®®å¢å¤§é˜ˆå€¼'
        WHEN applier_queue > 30000 THEN 'åº”ç”¨é˜Ÿåˆ—ç§¯å‹ï¼Œå»ºè®®è°ƒæ•´å‚æ•°'
        ELSE 'æ€§èƒ½æ­£å¸¸'
    END as ä¼˜åŒ–å»ºè®®
FROM (
    SELECT 
        (SELECT COUNT(*) FROM performance_schema.replication_group_member_stats 
         WHERE MEMBER_STATE = 'ONLINE') as online_members,
        MAX(COUNT_TRANSACTIONS_IN_QUEUE) as certification_queue,
        MAX(COUNT_TRANSACTIONS_REMOTE_IN_APPLIER_QUEUE) as applier_queue,
        MAX(COUNT_TRANSACTIONS_REMOTE_APPLIED) as replication_lag
    FROM performance_schema.replication_group_member_stats
) stats;
```

**ğŸ“Š é‡åŒ–è¯„ä¼°ä½“ç³»**

| æ€§èƒ½æŒ‡æ ‡ | **ä¼˜ç§€** | **è‰¯å¥½** | **éœ€è¦ä¼˜åŒ–** | **è°ƒä¼˜å»ºè®®** |
|---------|---------|---------|-------------|-------------|
| **äº‹åŠ¡ååé‡** | `>5000 TPS` | `2000-5000 TPS` | `<2000 TPS` | å¢åŠ èŠ‚ç‚¹æ•°é‡ï¼Œä¼˜åŒ–SQL |
| **å¤åˆ¶å»¶è¿Ÿ** | `<1ç§’` | `1-3ç§’` | `>3ç§’` | ä¼˜åŒ–ç½‘ç»œï¼Œè°ƒæ•´å‚æ•° |
| **è®¤è¯é€šè¿‡ç‡** | `>99%` | `95-99%` | `<95%` | å‡å°‘å†²çªäº‹åŠ¡ï¼Œä¼˜åŒ–ä¸šåŠ¡é€»è¾‘ |
| **CPUä½¿ç”¨ç‡** | `<70%` | `70-85%` | `>85%` | å‡çº§ç¡¬ä»¶é…ç½® |

### 3.3 æ€§èƒ½è°ƒä¼˜å®æˆ˜æ­¥éª¤


**ğŸ” ç¬¬ä¸€æ­¥ï¼šæ€§èƒ½é—®é¢˜è¯Šæ–­**

```sql
-- æŸ¥çœ‹MGRçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
SELECT 
    MEMBER_ID,
    MEMBER_HOST,
    MEMBER_PORT,
    MEMBER_STATE,
    MEMBER_ROLE
FROM performance_schema.replication_group_members;

-- æŸ¥çœ‹äº‹åŠ¡é˜Ÿåˆ—çŠ¶å†µ
SELECT 
    CHANNEL_NAME,
    COUNT_TRANSACTIONS_IN_QUEUE as 'è®¤è¯é˜Ÿåˆ—',
    COUNT_TRANSACTIONS_REMOTE_IN_APPLIER_QUEUE as 'åº”ç”¨é˜Ÿåˆ—',
    COUNT_TRANSACTIONS_REMOTE_APPLIED as 'å·²åº”ç”¨äº‹åŠ¡'
FROM performance_schema.replication_group_member_stats;
```

**âš™ï¸ ç¬¬äºŒæ­¥ï¼šå‚æ•°è°ƒä¼˜**

```ini
# æ ¹æ®è¯Šæ–­ç»“æœè°ƒæ•´å‚æ•°

# å¦‚æœè®¤è¯é˜Ÿåˆ—ç§¯å‹ä¸¥é‡
group_replication_flow_control_certifier_threshold=50000  # åŸå€¼25000

# å¦‚æœåº”ç”¨é˜Ÿåˆ—ç§¯å‹ä¸¥é‡  
group_replication_flow_control_applier_threshold=50000    # åŸå€¼25000

# å¦‚æœç½‘ç»œå¸¦å®½å……è¶³ä½†å»¶è¿Ÿé«˜
group_replication_compression_threshold=10000             # åŸå€¼1000ï¼Œå‡å°‘å‹ç¼©

# å¦‚æœå†…å­˜å……è¶³
group_replication_message_cache_size=2G                   # åŸå€¼1G
```

**ğŸ“ˆ ç¬¬ä¸‰æ­¥ï¼šæ•ˆæœéªŒè¯**

```bash
# ä½¿ç”¨sysbenchè¿›è¡Œå‹åŠ›æµ‹è¯•
sysbench oltp_read_write \
  --mysql-host=192.168.1.10 \
  --mysql-user=test \
  --mysql-password=password \
  --mysql-db=testdb \
  --tables=10 \
  --table-size=100000 \
  --threads=16 \
  --time=300 \
  --report-interval=10 \
  run
```

---

## 4. ğŸ­ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è§„èŒƒ


### 4.1 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥æ¸…å•


**ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•**

```
ç¡¬ä»¶ç¯å¢ƒæ£€æŸ¥ï¼š
â–¡ CPU: æ¯èŠ‚ç‚¹è‡³å°‘8æ ¸ï¼Œæ¨è16æ ¸ä»¥ä¸Š
â–¡ å†…å­˜: æ¯èŠ‚ç‚¹è‡³å°‘16GBï¼Œæ¨è32GBä»¥ä¸Š  
â–¡ å­˜å‚¨: SSDå­˜å‚¨ï¼ŒIOPS > 10000
â–¡ ç½‘ç»œ: ä¸‡å…†ä»¥å¤ªç½‘ï¼Œå»¶è¿Ÿ < 1ms

è½¯ä»¶ç¯å¢ƒæ£€æŸ¥ï¼š
â–¡ æ“ä½œç³»ç»Ÿ: CentOS 7.6+ æˆ– Ubuntu 18.04+
â–¡ MySQLç‰ˆæœ¬: 8.0.20+ (æ¨è8.0.35+)
â–¡ æ—¶é—´åŒæ­¥: NTPæˆ–Chronyé…ç½®æ­£ç¡®
â–¡ é˜²ç«å¢™: å¼€æ”¾3306ã€33061ç«¯å£

ç½‘ç»œç¯å¢ƒæ£€æŸ¥ï¼š
â–¡ èŠ‚ç‚¹é—´ç½‘ç»œå»¶è¿Ÿ < 2ms
â–¡ ç½‘ç»œå¸¦å®½ > 1Gbps
â–¡ æ— å•ç‚¹ç½‘ç»œæ•…éšœ
â–¡ DNSè§£ææ­£å¸¸
```

**ğŸ”§ æ ‡å‡†éƒ¨ç½²é…ç½®æ¨¡æ¿**

```ini
# ç”Ÿäº§ç¯å¢ƒæ ‡å‡†é…ç½®æ¨¡æ¿
[mysqld]
# ===== åŸºç¡€é…ç½® =====
port = 3306
bind-address = 0.0.0.0
default-storage-engine = InnoDB
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# ===== å†…å­˜é…ç½® =====
innodb_buffer_pool_size = 24G        # ç‰©ç†å†…å­˜çš„75%
innodb_buffer_pool_instances = 8     # æ¯ä¸ªå®ä¾‹3GB
innodb_log_file_size = 2G            # é‡åšæ—¥å¿—æ–‡ä»¶å¤§å°
innodb_log_buffer_size = 256M        # æ—¥å¿—ç¼“å†²åŒº

# ===== MGRé…ç½® =====
server-id = 1
gtid_mode = ON
enforce_gtid_consistency = ON
binlog_format = ROW
log-bin = mysql-bin
sync_binlog = 1
binlog_expire_logs_seconds = 259200   # 3å¤©

# ===== Group Replication =====
plugin_load_add = 'group_replication.so'
group_replication_group_name = "aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee"
group_replication_start_on_boot = off
group_replication_local_address = "192.168.1.10:33061"
group_replication_group_seeds = "192.168.1.10:33061,192.168.1.11:33061,192.168.1.12:33061"
group_replication_bootstrap_group = off
group_replication_single_primary_mode = ON
```

### 4.2 éƒ¨ç½²æ­¥éª¤è¯¦è§£


**ğŸš€ ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡**

```bash
# 1. æ—¶é—´åŒæ­¥é…ç½®
systemctl enable chronyd
systemctl start chronyd
chrony sources -v

# 2. é˜²ç«å¢™é…ç½®
firewall-cmd --permanent --add-port=3306/tcp
firewall-cmd --permanent --add-port=33061/tcp
firewall-cmd --reload

# 3. ç³»ç»Ÿå‚æ•°ä¼˜åŒ–
cat >> /etc/sysctl.conf << EOF
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 65535
net.core.netdev_max_backlog = 5000
vm.swappiness = 1
EOF
sysctl -p
```

**âš™ï¸ ç¬¬äºŒæ­¥ï¼šMySQLå®‰è£…é…ç½®**

```bash
# 1. å®‰è£…MySQL 8.0
wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
yum install mysql80-community-release-el7-3.noarch.rpm
yum install mysql-community-server

# 2. å¯åŠ¨å¹¶è·å–ä¸´æ—¶å¯†ç 
systemctl start mysqld
grep 'temporary password' /var/log/mysqld.log

# 3. åˆå§‹åŒ–å®‰å…¨è®¾ç½®
mysql_secure_installation
```

**ğŸ”— ç¬¬ä¸‰æ­¥ï¼šMGRé›†ç¾¤åˆå§‹åŒ–**

```sql
-- åœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼ˆå¼•å¯¼èŠ‚ç‚¹ï¼‰
SET SQL_LOG_BIN=0;
CREATE USER 'repl'@'%' IDENTIFIED BY 'ReplicationPassword123!';
GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%';
GRANT CONNECTION_ADMIN ON *.* TO 'repl'@'%';
GRANT BACKUP_ADMIN ON *.* TO 'repl'@'%';
GRANT GROUP_REPLICATION_STREAM ON *.* TO 'repl'@'%';
FLUSH PRIVILEGES;
SET SQL_LOG_BIN=1;

-- é…ç½®å¤åˆ¶é€šé“
CHANGE REPLICATION SOURCE TO 
    SOURCE_USER='repl', 
    SOURCE_PASSWORD='ReplicationPassword123!' 
    FOR CHANNEL 'group_replication_recovery';

-- å¯åŠ¨ç»„å¤åˆ¶
SET GLOBAL group_replication_bootstrap_group=ON;
START GROUP_REPLICATION;
SET GLOBAL group_replication_bootstrap_group=OFF;

-- éªŒè¯çŠ¶æ€
SELECT * FROM performance_schema.replication_group_members;
```

---

## 5. ğŸ¤– è¿ç»´è‡ªåŠ¨åŒ–ä¸ç›‘æ§


### 5.1 è¿ç»´è‡ªåŠ¨åŒ–ç¨‹åº¦è¯„ä¼°


**ğŸ“Š è‡ªåŠ¨åŒ–æˆç†Ÿåº¦æ¨¡å‹**

```
Level 0 - æ‰‹å·¥è¿ç»´ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ æ‰‹åŠ¨éƒ¨ç½²å’Œé…ç½®                     â”‚
â”‚ â€¢ äººå·¥ç›‘æ§å’Œå‘Šè­¦                     â”‚
â”‚ â€¢ æ‰‹åŠ¨æ•…éšœå¤„ç†                       â”‚
â”‚ â€¢ é£é™©ï¼šäººä¸ºé”™è¯¯ï¼Œå“åº”æ…¢              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Level 1 - è„šæœ¬åŒ–ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬                     â”‚
â”‚ â€¢ ç›‘æ§è„šæœ¬å’Œç®€å•å‘Šè­¦                 â”‚
â”‚ â€¢ åŠè‡ªåŠ¨æ•…éšœæ¢å¤                     â”‚
â”‚ â€¢ æ”¹è¿›ï¼šå‡å°‘é‡å¤å·¥ä½œ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Level 2 - å·¥å…·åŒ–ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ ç»Ÿä¸€è¿ç»´å¹³å°                       â”‚
â”‚ â€¢ å®Œæ•´ç›‘æ§ä½“ç³»                       â”‚
â”‚ â€¢ è‡ªåŠ¨æ•…éšœåˆ‡æ¢                       â”‚
â”‚ â€¢ ä¼˜åŠ¿ï¼šå¿«é€Ÿå“åº”ï¼Œé™ä½é£é™©            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Level 3 - æ™ºèƒ½åŒ–ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ AIé©±åŠ¨çš„è¿ç»´å†³ç­–                   â”‚
â”‚ â€¢ é¢„æµ‹æ€§ç»´æŠ¤                         â”‚
â”‚ â€¢ è‡ªæ„ˆèƒ½åŠ›                          â”‚
â”‚ â€¢ ä»·å€¼ï¼šä¸»åŠ¨é˜²æŠ¤ï¼Œæé«˜å¯ç”¨æ€§          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç›‘æ§ä½“ç³»å»ºè®¾


**ğŸ” å…¨é¢ç›‘æ§æŒ‡æ ‡**

```sql
-- MGRæ ¸å¿ƒç›‘æ§æŸ¥è¯¢é›†åˆ

-- 1. é›†ç¾¤æˆå‘˜çŠ¶æ€ç›‘æ§
CREATE VIEW mgr_cluster_status AS
SELECT 
    MEMBER_HOST as 'èŠ‚ç‚¹åœ°å€',
    MEMBER_PORT as 'ç«¯å£',
    MEMBER_STATE as 'çŠ¶æ€',
    MEMBER_ROLE as 'è§’è‰²',
    IF(MEMBER_STATE='ONLINE', 'æ­£å¸¸', 'å¼‚å¸¸') as 'å¥åº·çŠ¶æ€'
FROM performance_schema.replication_group_members
ORDER BY MEMBER_ROLE DESC;

-- 2. æ€§èƒ½æŒ‡æ ‡ç›‘æ§  
CREATE VIEW mgr_performance_stats AS
SELECT 
    CHANNEL_NAME as 'é€šé“åç§°',
    COUNT_TRANSACTIONS_IN_QUEUE as 'è®¤è¯é˜Ÿåˆ—é•¿åº¦',
    COUNT_TRANSACTIONS_REMOTE_IN_APPLIER_QUEUE as 'åº”ç”¨é˜Ÿåˆ—é•¿åº¦',
    COUNT_TRANSACTIONS_REMOTE_APPLIED as 'å·²åº”ç”¨äº‹åŠ¡æ•°',
    COUNT_TRANSACTIONS_LOCAL_PROPOSED as 'æœ¬åœ°æäº¤äº‹åŠ¡æ•°'
FROM performance_schema.replication_group_member_stats;

-- 3. å†²çªæ£€æµ‹ç›‘æ§
CREATE VIEW mgr_conflict_stats AS
SELECT 
    COUNT_TRANSACTIONS_CHECKED as 'æ£€æŸ¥äº‹åŠ¡æ€»æ•°',
    COUNT_CONFLICTS_DETECTED as 'æ£€æµ‹åˆ°çš„å†²çªæ•°',
    ROUND((COUNT_CONFLICTS_DETECTED/COUNT_TRANSACTIONS_CHECKED)*100, 2) as 'å†²çªç‡%'
FROM performance_schema.replication_group_member_stats
WHERE COUNT_TRANSACTIONS_CHECKED > 0;
```

**ğŸ“Š ç›‘æ§å‘Šè­¦é…ç½®**

```bash
#!/bin/bash
# MGRç›‘æ§è„šæœ¬ - mgr_monitor.sh

# æ£€æŸ¥é›†ç¾¤æˆå‘˜çŠ¶æ€
check_cluster_status() {
    local offline_count=$(mysql -e "
        SELECT COUNT(*) FROM performance_schema.replication_group_members 
        WHERE MEMBER_STATE != 'ONLINE'
    " -s -N)
    
    if [ $offline_count -gt 0 ]; then
        echo "è­¦å‘Šï¼šå‘ç° $offline_count ä¸ªç¦»çº¿èŠ‚ç‚¹"
        # å‘é€å‘Šè­¦é€šçŸ¥
        send_alert "MGRé›†ç¾¤å¼‚å¸¸" "æœ‰èŠ‚ç‚¹ç¦»çº¿ï¼Œè¯·ç«‹å³æ£€æŸ¥"
    fi
}

# æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
check_replication_lag() {
    local max_queue=$(mysql -e "
        SELECT MAX(COUNT_TRANSACTIONS_IN_QUEUE) 
        FROM performance_schema.replication_group_member_stats
    " -s -N)
    
    if [ $max_queue -gt 10000 ]; then
        echo "è­¦å‘Šï¼šå¤åˆ¶é˜Ÿåˆ—ç§¯å‹ä¸¥é‡ ($max_queue)"
        send_alert "MGRæ€§èƒ½å‘Šè­¦" "å¤åˆ¶é˜Ÿåˆ—ç§¯å‹ï¼š$max_queue"
    fi
}

# å‘é€å‘Šè­¦é€šçŸ¥
send_alert() {
    local title="$1"
    local message="$2"
    # è¿™é‡Œå¯ä»¥é›†æˆé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€é‚®ä»¶ç­‰é€šçŸ¥æ–¹å¼
    curl -X POST "https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN" \
         -H 'Content-Type: application/json' \
         -d "{\"msgtype\":\"text\",\"text\":{\"content\":\"$title: $message\"}}"
}

# ä¸»æ£€æŸ¥æµç¨‹
main() {
    echo "$(date): å¼€å§‹MGRå¥åº·æ£€æŸ¥"
    check_cluster_status
    check_replication_lag
    echo "$(date): MGRå¥åº·æ£€æŸ¥å®Œæˆ"
}

# æ‰§è¡Œæ£€æŸ¥
main
```

---

## 6. ğŸ›¡ï¸ æ•…éšœé¢„é˜²ä¸å®¹é‡è§„åˆ’


### 6.1 æ•…éšœé¢„é˜²æªæ–½


**âš ï¸ å¸¸è§æ•…éšœé¢„é˜²**

```
ç½‘ç»œåˆ†åŒºæ•…éšœé¢„é˜²ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¢„é˜²æªæ–½                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ åŒç½‘å¡ç»‘å®šï¼Œé¿å…å•ç‚¹ç½‘ç»œæ•…éšœ        â”‚
â”‚ â€¢ è·¨æœºæˆ¿éƒ¨ç½²ï¼Œåˆ†æ•£é£é™©               â”‚
â”‚ â€¢ ç½‘ç»œç›‘æ§ï¼ŒåŠæ—¶å‘ç°ç½‘ç»œé—®é¢˜          â”‚
â”‚ â€¢ åˆç†é…ç½®è¶…æ—¶å‚æ•°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è„‘è£‚é—®é¢˜é¢„é˜²ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¢„é˜²æªæ–½                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å¥‡æ•°èŠ‚ç‚¹éƒ¨ç½²ï¼Œç¡®ä¿å¤šæ•°æ´¾            â”‚
â”‚ â€¢ è®¾ç½®åˆç†çš„ä»²è£èŠ‚ç‚¹                 â”‚
â”‚ â€¢ ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸          â”‚
â”‚ â€¢ åˆ¶å®šåº”æ€¥å¤„ç†æµç¨‹                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€§èƒ½é—®é¢˜é¢„é˜²ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¢„é˜²æªæ–½                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å®šæœŸæ€§èƒ½æµ‹è¯•å’Œå®¹é‡è¯„ä¼°              â”‚
â”‚ â€¢ ç›‘æ§å…³é”®æŒ‡æ ‡ï¼Œè®¾ç½®å‘Šè­¦é˜ˆå€¼          â”‚
â”‚ â€¢ ä¼˜åŒ–åº”ç”¨SQLï¼Œå‡å°‘é”å†²çª            â”‚
â”‚ â€¢ åˆç†è§„åˆ’ä¸šåŠ¡å¢é•¿                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å®¹é‡è§„åˆ’å»ºè®®


**ğŸ“ˆ å®¹é‡è¯„ä¼°æ¨¡å‹**

```sql
-- å®¹é‡è¯„ä¼°æŸ¥è¯¢è„šæœ¬
SELECT 
    'å½“å‰å®¹é‡æŒ‡æ ‡' as æŒ‡æ ‡ç±»å‹,
    CONCAT(
        'æ•°æ®é‡: ', ROUND(SUM(data_length)/1024/1024/1024, 2), 'GB, ',
        'ç´¢å¼•é‡: ', ROUND(SUM(index_length)/1024/1024/1024, 2), 'GB, ',
        'æ€»è®¡: ', ROUND(SUM(data_length + index_length)/1024/1024/1024, 2), 'GB'
    ) as å½“å‰çŠ¶å†µ
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys');

-- é¢„æµ‹6ä¸ªæœˆåçš„å®¹é‡éœ€æ±‚
SELECT 
    'å®¹é‡é¢„æµ‹' as ç±»å‹,
    CONCAT(
        'æŒ‰å½“å‰å¢é•¿ç‡é¢„æµ‹6ä¸ªæœˆåéœ€è¦: ',
        ROUND(current_size * 1.5, 2), 'GB å­˜å‚¨ç©ºé—´'
    ) as é¢„æµ‹ç»“æœ
FROM (
    SELECT SUM(data_length + index_length)/1024/1024/1024 as current_size
    FROM information_schema.tables 
    WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys')
) t;
```

**ğŸ¯ å®¹é‡è§„åˆ’æŒ‡å¯¼åŸåˆ™**

| ä¸šåŠ¡è§„æ¨¡ | **èŠ‚ç‚¹é…ç½®** | **å­˜å‚¨å®¹é‡** | **ç½‘ç»œè¦æ±‚** | **é¢„ç•™ç©ºé—´** |
|---------|-------------|-------------|-------------|-------------|
| **å°å‹** | `4C8G` | `500GB SSD` | `åƒå…†ç½‘ç»œ` | `50%é¢„ç•™` |
| **ä¸­å‹** | `8C16G` | `2TB SSD` | `ä¸‡å…†ç½‘ç»œ` | `40%é¢„ç•™` |
| **å¤§å‹** | `16C32G` | `4TB SSD` | `ä¸“ç”¨ç½‘ç»œ` | `30%é¢„ç•™` |
| **è¶…å¤§å‹** | `32C64G+` | `8TB+ SSD` | `ä¸“ç”¨æœºæˆ¿` | `20%é¢„ç•™` |

---

## 7. â˜ï¸ äº‘åŸç”Ÿç¯å¢ƒä¼˜åŒ–ç­–ç•¥


### 7.1 äº‘åŸç”Ÿç¯å¢ƒç‰¹ç‚¹


**ğŸŒ¤ï¸ äº‘åŸç”Ÿä¸‹çš„MGRæŒ‘æˆ˜**

```
ä¼ ç»Ÿç¯å¢ƒ vs äº‘åŸç”Ÿç¯å¢ƒï¼š

ä¼ ç»Ÿç‰©ç†ç¯å¢ƒï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ å›ºå®šç¡¬ä»¶é…ç½®                       â”‚
â”‚ â€¢ ç¨³å®šç½‘ç»œå»¶è¿Ÿ                       â”‚
â”‚ â€¢ å¯é¢„æµ‹çš„æ€§èƒ½                       â”‚
â”‚ â€¢ æ‰‹åŠ¨æ‰©å®¹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

äº‘åŸç”Ÿç¯å¢ƒï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ åŠ¨æ€èµ„æºåˆ†é…                       â”‚
â”‚ â€¢ ç½‘ç»œå»¶è¿Ÿå¯èƒ½æ³¢åŠ¨                   â”‚
â”‚ â€¢ æ€§èƒ½å¯èƒ½å—é‚»å±…å½±å“                 â”‚
â”‚ â€¢ è‡ªåŠ¨å¼¹æ€§æ‰©ç¼©å®¹                     â”‚
â”‚ â€¢ å®¹å™¨åŒ–éƒ¨ç½²                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Kubernetesç¯å¢ƒä¼˜åŒ–


**ğŸ›ï¸ K8sç¯å¢ƒéƒ¨ç½²ä¼˜åŒ–**

```yaml
# MGRåœ¨Kubernetesä¸­çš„éƒ¨ç½²é…ç½®
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql-mgr
spec:
  serviceName: mysql-mgr-headless
  replicas: 3
  selector:
    matchLabels:
      app: mysql-mgr
  template:
    metadata:
      labels:
        app: mysql-mgr
    spec:
      # åäº²å’Œæ€§ï¼šç¡®ä¿èŠ‚ç‚¹åˆ†æ•£éƒ¨ç½²
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - mysql-mgr
            topologyKey: kubernetes.io/hostname
      
      containers:
      - name: mysql
        image: mysql:8.0.35
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: root-password
        
        # èµ„æºé™åˆ¶
        resources:
          requests:
            memory: "4Gi"
            cpu: "2"
          limits:
            memory: "8Gi"
            cpu: "4"
        
        # å­˜å‚¨å·æŒ‚è½½
        volumeMounts:
        - name: mysql-storage
          mountPath: /var/lib/mysql
        - name: mysql-config
          mountPath: /etc/mysql/conf.d
          
  # æŒä¹…åŒ–å­˜å‚¨
  volumeClaimTemplates:
  - metadata:
      name: mysql-storage
    spec:
      accessModes: ["ReadWriteOnce"]
      storageClassName: "fast-ssd"  # ä½¿ç”¨SSDå­˜å‚¨ç±»
      resources:
        requests:
          storage: 100Gi
```

**ğŸ”§ äº‘ç¯å¢ƒå‚æ•°ä¼˜åŒ–**

```ini
# äº‘ç¯å¢ƒä¸“ç”¨é…ç½®ä¼˜åŒ–
[mysqld]
# ===== äº‘ç¯å¢ƒç½‘ç»œä¼˜åŒ– =====
group_replication_communication_debug_options=GCS_DEBUG_ALL
group_replication_member_expel_timeout=300        # å¢åŠ è¶…æ—¶æ—¶é—´ï¼Œé€‚åº”äº‘ç¯å¢ƒç½‘ç»œæ³¢åŠ¨
group_replication_autorejoin_tries=3              # è‡ªåŠ¨é‡æ–°åŠ å…¥å°è¯•æ¬¡æ•°

# ===== äº‘ç¯å¢ƒæ€§èƒ½ä¼˜åŒ– =====
group_replication_flow_control_period=2           # æµæ§æ£€æŸ¥å‘¨æœŸ(ç§’)
group_replication_flow_control_hold_percent=10    # æµæ§é˜»å¡ç™¾åˆ†æ¯”
group_replication_flow_control_release_percent=50 # æµæ§é‡Šæ”¾ç™¾åˆ†æ¯”

# ===== å®¹å™¨ç¯å¢ƒå†…å­˜ä¼˜åŒ– =====
innodb_buffer_pool_size=3G                        # å®¹å™¨å†…å­˜çš„60-70%
innodb_buffer_pool_instances=3                    # æ ¹æ®å®¹å™¨CPUæ ¸æ•°è°ƒæ•´
performance_schema=OFF                             # åœ¨èµ„æºæœ‰é™çš„å®¹å™¨ä¸­å¯ä»¥å…³é—­
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ MGRæœ€ä½³å®è·µæ ¸å¿ƒåŸåˆ™**
```
æ¶æ„è®¾è®¡ï¼šå¥‡æ•°èŠ‚ç‚¹ã€è·¨å¯ç”¨åŒºéƒ¨ç½²ã€åˆç†è§„æ¨¡è§„åˆ’
å‚æ•°è°ƒä¼˜ï¼šåŸºäºè´Ÿè½½ç‰¹å¾çš„ä¸ªæ€§åŒ–é…ç½®
æ€§èƒ½ä¼˜åŒ–ï¼šç›‘æ§é©±åŠ¨çš„æŒç»­æ”¹è¿›
è¿ç»´è§„èŒƒï¼šè‡ªåŠ¨åŒ–ã€æ ‡å‡†åŒ–ã€å¯è§‚æµ‹
æ•…éšœé¢„é˜²ï¼šä¸»åŠ¨ç›‘æ§ã€å®¹é‡è§„åˆ’ã€åº”æ€¥é¢„æ¡ˆ
```

### 8.2 å…³é”®é…ç½®è®°å¿†


**ğŸ”§ æ ¸å¿ƒå‚æ•°é€Ÿè®°**
```ini
# åŸºç¡€ä¸‰è¦ç´ 
server-id=å”¯ä¸€å€¼                    # èº«ä»½æ ‡è¯†
gtid_mode=ON                       # äº‹åŠ¡æ ‡è¯†  
group_replication_group_name=UUID  # é›†ç¾¤æ ‡è¯†

# æ€§èƒ½ä¸‰è¦ç´   
group_replication_flow_control_certifier_threshold=25000  # è®¤è¯é˜Ÿåˆ—
group_replication_flow_control_applier_threshold=25000     # åº”ç”¨é˜Ÿåˆ—
group_replication_message_cache_size=1G                    # æ¶ˆæ¯ç¼“å­˜

# ç½‘ç»œä¸‰è¦ç´ 
group_replication_local_address="IP:PORT"              # æœ¬åœ°åœ°å€
group_replication_group_seeds="IP1:PORT1,IP2:PORT2"    # ç§å­åˆ—è¡¨  
group_replication_compression_threshold=1000           # å‹ç¼©é˜ˆå€¼
```

### 8.3 æ•…éšœå¤„ç†æ€è·¯


**ğŸš¨ é—®é¢˜è¯Šæ–­æµç¨‹**
```
ç¬¬ä¸€æ­¥ï¼šæŸ¥çœ‹é›†ç¾¤çŠ¶æ€
â†“
SELECT * FROM performance_schema.replication_group_members;

ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æ€§èƒ½æŒ‡æ ‡  
â†“
SELECT * FROM performance_schema.replication_group_member_stats;

ç¬¬ä¸‰æ­¥ï¼šåˆ†æå…·ä½“é—®é¢˜
â†“
â€¢ èŠ‚ç‚¹ç¦»çº¿ â†’ æ£€æŸ¥ç½‘ç»œå’Œé…ç½®
â€¢ é˜Ÿåˆ—ç§¯å‹ â†’ è°ƒæ•´æµæ§å‚æ•°
â€¢ å†²çªé¢‘ç¹ â†’ ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘

ç¬¬å››æ­¥ï¼šå®æ–½è§£å†³æ–¹æ¡ˆ
â†“
â€¢ å‚æ•°è°ƒæ•´ â†’ é‡å¯æœåŠ¡
â€¢ é…ç½®ä¿®æ”¹ â†’ é€æ­¥ç”Ÿæ•ˆ
â€¢ ç¡¬ä»¶å‡çº§ â†’ åˆ†æ‰¹å¤„ç†
```

### 8.4 ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•


**âœ… éƒ¨ç½²å‰å¿…æ£€é¡¹ç›®**
- **ç¡¬ä»¶**ï¼šCPUã€å†…å­˜ã€å­˜å‚¨ã€ç½‘ç»œæ»¡è¶³æœ€ä½è¦æ±‚
- **è½¯ä»¶**ï¼šMySQLç‰ˆæœ¬å…¼å®¹ï¼Œæ“ä½œç³»ç»Ÿä¼˜åŒ–å®Œæˆ  
- **ç½‘ç»œ**ï¼šå»¶è¿Ÿæµ‹è¯•é€šè¿‡ï¼Œé˜²ç«å¢™é…ç½®æ­£ç¡®
- **å®‰å…¨**ï¼šç”¨æˆ·æƒé™é…ç½®ï¼Œå¯†ç ç­–ç•¥è®¾ç½®
- **ç›‘æ§**ï¼šå‘Šè­¦è§„åˆ™é…ç½®ï¼Œé€šçŸ¥æ¸ é“æµ‹è¯•
- **å¤‡ä»½**ï¼šå¤‡ä»½ç­–ç•¥åˆ¶å®šï¼Œæ¢å¤æµç¨‹éªŒè¯

**ğŸ”§ è¿ç»´å¿…å¤‡å·¥å…·**
- **ç›‘æ§å·¥å…·**ï¼šPrometheus + Grafana
- **å‘Šè­¦é€šçŸ¥**ï¼šé’‰é’‰/ä¼ä¸šå¾®ä¿¡/é‚®ä»¶
- **è‡ªåŠ¨åŒ–å·¥å…·**ï¼šAnsible/Terraform
- **å‹æµ‹å·¥å…·**ï¼šsysbench/mysqlslap
- **å¤‡ä»½å·¥å…·**ï¼šxtrabackup/mysqldump

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
MGRæœ€ä½³å®è·µè¦è®°ç‰¢ï¼Œ
æ¶æ„è®¾è®¡æ˜¯åŸºç¡€ï¼Œå¥‡æ•°èŠ‚ç‚¹ä¸èƒ½å°‘ï¼›
å‚æ•°è°ƒä¼˜çœ‹è´Ÿè½½ï¼Œè®¤è¯åº”ç”¨é˜Ÿåˆ—è°ƒï¼›
ç›‘æ§å‘Šè­¦è¦åŠæ—¶ï¼Œæ•…éšœé¢„é˜²èƒœæ²»ç–—ï¼›
äº‘åŸç”Ÿç¯å¢ƒæœ‰ç‰¹ç‚¹ï¼Œå®¹å™¨éƒ¨ç½²è¦ä¼˜åŒ–ï¼›
ç”Ÿäº§éƒ¨ç½²æŒ‰æ¸…å•ï¼Œè‡ªåŠ¨è¿ç»´æ˜¯ç›®æ ‡ï¼
```