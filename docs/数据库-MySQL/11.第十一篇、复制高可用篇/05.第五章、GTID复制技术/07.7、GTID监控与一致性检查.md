---
title: 7ã€GTIDç›‘æ§ä¸ä¸€è‡´æ€§æ£€æŸ¥
---
## ğŸ“š ç›®å½•

1. [GTIDç›‘æ§åŸºç¡€æ¦‚å¿µ](#1-GTIDç›‘æ§åŸºç¡€æ¦‚å¿µ)
2. [GTIDçŠ¶æ€ç›‘æ§è¯¦è§£](#2-GTIDçŠ¶æ€ç›‘æ§è¯¦è§£)
3. [ä¸€è‡´æ€§æ£€æŸ¥æ–¹æ³•](#3-ä¸€è‡´æ€§æ£€æŸ¥æ–¹æ³•)
4. [æ•°æ®å®Œæ•´æ€§éªŒè¯](#4-æ•°æ®å®Œæ•´æ€§éªŒè¯)
5. [ç›‘æ§æŒ‡æ ‡ä¸å‘Šè­¦](#5-ç›‘æ§æŒ‡æ ‡ä¸å‘Šè­¦)
6. [è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·](#6-è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ GTIDç›‘æ§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯GTIDç›‘æ§


**GTIDç›‘æ§**å°±åƒæ˜¯ç»™MySQLå¤åˆ¶ç³»ç»Ÿè£…ä¸Šä¸€ä¸ª"å¥åº·ç›‘æµ‹ä»ª"ï¼Œå®æ—¶æ£€æŸ¥ä¸»ä»å¤åˆ¶çš„çŠ¶æ€æ˜¯å¦æ­£å¸¸ã€‚

```
ç®€å•ç†è§£ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šé äººå·¥æŸ¥çœ‹æ—¥å¿— â†’ å‘ç°é—®é¢˜æ—¶ä¸ºæ—¶å·²æ™š
GTIDç›‘æ§ï¼šè‡ªåŠ¨åŒ–ç›‘æ§ â†’ æå‰å‘ç°é—®é¢˜ï¼ŒåŠæ—¶å¤„ç†

å°±åƒä½“æ£€ï¼š
- å®šæœŸä½“æ£€ = å®šæœŸç›‘æ§GTIDçŠ¶æ€
- æŒ‡æ ‡å¼‚å¸¸ = GTIDä¸ä¸€è‡´å‘Šè­¦
- åŠæ—¶æ²»ç–— = å¿«é€Ÿä¿®å¤å¤åˆ¶é—®é¢˜
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦GTIDç›‘æ§


**ç›‘æ§çš„å¿…è¦æ€§**ï¼š

ğŸ’¡ **æ•°æ®å®‰å…¨ä¿éšœ**
```
é—®é¢˜åœºæ™¯ï¼š
ä¸»åº“ï¼šå·²æ‰§è¡Œäº‹åŠ¡ 1-1000
ä»åº“ï¼šåªæ‰§è¡Œäº†äº‹åŠ¡ 1-998 (ä¸¢å¤±äº†999ã€1000)

åæœï¼š
- æ•°æ®ä¸ä¸€è‡´
- åº”ç”¨è¯»å–é”™è¯¯æ•°æ®
- ä¸šåŠ¡é€»è¾‘å¼‚å¸¸
```

ğŸ’¡ **æ•…éšœå¿«é€Ÿå‘ç°**
```
ä¼ ç»Ÿå‘ç°æ–¹å¼ï¼š
ç”¨æˆ·åé¦ˆ â†’ å¼€å‘ç¡®è®¤ â†’ DBAä»‹å…¥ â†’ å®šä½é—®é¢˜
è€—æ—¶ï¼šå‡ å°æ—¶åˆ°å‡ å¤©

GTIDç›‘æ§æ–¹å¼ï¼š
å¼‚å¸¸å‘ç”Ÿ â†’ ç«‹å³å‘Šè­¦ â†’ è‡ªåŠ¨å®šä½ â†’ å¿«é€Ÿä¿®å¤
è€—æ—¶ï¼šå‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶
```

### 1.3 GTIDç›‘æ§æ ¸å¿ƒåŸç†


**ç›‘æ§åŸç†å›¾ç¤º**ï¼š
```
ä¸»åº“ MySQL Master                    ä»åº“ MySQL Slave
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ gtid_executed   â”‚                  â”‚ gtid_executed   â”‚
â”‚ A:1-1000        â”‚ â† ç›‘æ§å¯¹æ¯” â†’     â”‚ A:1-998         â”‚
â”‚                 â”‚                  â”‚                 â”‚
â”‚ gtid_purged     â”‚                  â”‚ gtid_purged     â”‚
â”‚ A:1-500         â”‚                  â”‚ A:1-500         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                                    â†“
    ç›‘æ§å·¥å…·æ”¶é›†                         ç›‘æ§å·¥å…·æ”¶é›†
        â†“                                    â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚         ç›‘æ§ä¸­å¿ƒ                â”‚
           â”‚   âœ… å¯¹æ¯”GTIDé›†åˆ              â”‚
           â”‚   ğŸš¨ æ£€æµ‹ä¸ä¸€è‡´                â”‚
           â”‚   ğŸ“Š ç”Ÿæˆç›‘æ§æŠ¥å‘Š              â”‚
           â”‚   ğŸ“¬ å‘é€å‘Šè­¦é€šçŸ¥              â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“Š GTIDçŠ¶æ€ç›‘æ§è¯¦è§£


### 2.1 gtid_executedç›‘æ§


**gtid_executed**æ˜¯MySQLå·²ç»æ‰§è¡Œçš„æ‰€æœ‰äº‹åŠ¡çš„GTIDé›†åˆï¼Œç›¸å½“äºæ•°æ®åº“çš„"æ‰§è¡Œè®°å½•æœ¬"ã€‚

#### ğŸ” ç›‘æ§æ–¹æ³•


```sql
-- æŸ¥çœ‹å½“å‰å·²æ‰§è¡Œçš„GTIDé›†åˆ
SHOW GLOBAL VARIABLES LIKE 'gtid_executed';

-- æ›´è¯¦ç»†çš„GTIDçŠ¶æ€ä¿¡æ¯
SELECT 
    $$global.gtid_executed as 'å·²æ‰§è¡ŒGTID',
    $$global.gtid_purged as 'å·²æ¸…ç†GTID',
    $$global.gtid_owned as 'æ­£åœ¨æ‰§è¡ŒGTID';
```

#### ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡


| ç›‘æ§é¡¹ç›® | **è¯´æ˜** | **æ­£å¸¸èŒƒå›´** | **å¼‚å¸¸å‘Šè­¦** |
|---------|----------|-------------|-------------|
| `GTIDæ•°é‡å¢é•¿` | `æ¯ç§’æ–°å¢çš„GTIDæ•°é‡` | `ä¸ä¸šåŠ¡QPSåŒ¹é…` | `çªç„¶åœæ­¢å¢é•¿` |
| `GTIDè¿ç»­æ€§` | `æ˜¯å¦å­˜åœ¨GTIDé—´éš™` | `è¿ç»­æ— é—´éš™` | `å‡ºç°é—´éš™æˆ–è·³è·ƒ` |
| `ä¸»ä»GTIDå·®å¼‚` | `ä¸»ä»ä¹‹é—´çš„GTIDå·®è·` | `<100ä¸ªäº‹åŠ¡` | `>1000ä¸ªäº‹åŠ¡` |

#### ğŸ› ï¸ ç›‘æ§è„šæœ¬ç¤ºä¾‹


```python
#!/usr/bin/env python3
# GTIDæ‰§è¡ŒçŠ¶æ€ç›‘æ§è„šæœ¬

import mysql.connector
import time
import logging

class GTIDMonitor:
    def __init__(self, host, user, password, port=3306):
        self.host = host
        self.user = user
        self.password = password
        self.port = port
        
    def get_gtid_executed(self):
        """è·å–å·²æ‰§è¡Œçš„GTIDé›†åˆ"""
        try:
            conn = mysql.connector.connect(
                host=self.host,
                user=self.user,
                password=self.password,
                port=self.port
            )
            cursor = conn.cursor()
            cursor.execute("SELECT $$global.gtid_executed")
            result = cursor.fetchone()[0]
            conn.close()
            return result
        except Exception as e:
            logging.error(f"è·å–GTIDå¤±è´¥: {e}")
            return None
    
    def parse_gtid_count(self, gtid_set):
        """è§£æGTIDé›†åˆä¸­çš„äº‹åŠ¡æ•°é‡"""
        if not gtid_set:
            return 0
        
        total_count = 0
        # è§£æç±»ä¼¼ "server_uuid:1-1000,server_uuid2:1-500" çš„æ ¼å¼
        for gtid_range in gtid_set.split(','):
            if ':' in gtid_range:
                range_part = gtid_range.split(':')[1]
                if '-' in range_part:
                    start, end = map(int, range_part.split('-'))
                    total_count += (end - start + 1)
                else:
                    total_count += 1
        return total_count

# ä½¿ç”¨ç¤ºä¾‹
monitor = GTIDMonitor('127.0.0.1', 'monitor_user', 'password')
gtid_executed = monitor.get_gtid_executed()
print(f"å½“å‰å·²æ‰§è¡ŒGTID: {gtid_executed}")
```

### 2.2 gtid_purgedç›‘æ§


**gtid_purged**è®°å½•äº†å·²ç»è¢«æ¸…ç†çš„äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„GTIDï¼Œç›¸å½“äº"å·²å½’æ¡£è®°å½•"ã€‚

#### âš ï¸ **é‡è¦ç†è§£**


```
gtid_purged çš„ä½œç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ 1-100â”‚101-200â”‚201-300â”‚301-400â”‚405-500â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜     â”‚
â”‚   å·²æ¸…ç†  å·²æ¸…ç†   ä¿ç•™    ä¿ç•™    ä¿ç•™    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

gtid_purged = "server_uuid:1-200"
è¡¨ç¤ºï¼šGTID 1-200 çš„æ—¥å¿—å·²è¢«æ¸…ç†ï¼Œæ— æ³•æ¢å¤
```

#### ğŸ” ç›‘æ§è¦ç‚¹


```sql
-- æ£€æŸ¥å·²æ¸…ç†çš„GTID
SELECT $$global.gtid_purged;

-- æ£€æŸ¥å¯ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—èŒƒå›´
SHOW BINARY LOGS;

-- æ£€æŸ¥ç‰¹å®šäºŒè¿›åˆ¶æ—¥å¿—çš„GTIDèŒƒå›´  
SHOW BINLOG EVENTS IN 'mysql-bin.000001' LIMIT 5;
```

**âš ï¸ å…³é”®ç›‘æ§å‘Šè­¦**ï¼š
```
ğŸš¨ å‘Šè­¦æ¡ä»¶ï¼š
1. gtid_purged å¿«é€Ÿå¢é•¿ â†’ æ—¥å¿—æ¸…ç†è¿‡äºé¢‘ç¹
2. ä»åº“çš„ gtid_executed è½åäºä¸»åº“çš„ gtid_purged â†’ ä»åº“æ— æ³•è¿½ä¸Šä¸»åº“
3. gtid_purged ä¸ gtid_executed å·®è·è¿‡å¤§ â†’ å¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±é£é™©
```

### 2.3 ä¸»ä»GTIDé›†åˆä¸€è‡´æ€§æ£€æŸ¥


#### ğŸ”„ ä¸€è‡´æ€§æ£€æŸ¥åŸç†


```
ä¸»åº“çŠ¶æ€ï¼š                         ä»åº“çŠ¶æ€ï¼š
gtid_executed: A:1-1000           gtid_executed: A:1-998
                                  
æ£€æŸ¥é€»è¾‘ï¼š
1ï¸âƒ£ æ”¶é›†ä¸»ä»ä¸¤ç«¯çš„ gtid_executed
2ï¸âƒ£ è§£æGTIDé›†åˆï¼Œè®¡ç®—å·®å¼‚
3ï¸âƒ£ åˆ¤æ–­å·®å¼‚æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…
4ï¸âƒ£ ç”Ÿæˆä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š
```

#### ğŸ“ æ£€æŸ¥è„šæœ¬å®ç°


```bash
#!/bin/bash
# ä¸»ä»GTIDä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬

# é…ç½®ä¿¡æ¯
MASTER_HOST="192.168.1.10"
SLAVE_HOST="192.168.1.11"
MYSQL_USER="monitor"
MYSQL_PASS="password"

# è·å–GTIDå‡½æ•°
get_gtid_executed() {
    local host=$1
    mysql -h${host} -u${MYSQL_USER} -p${MYSQL_PASS} -se "SELECT $$global.gtid_executed" 2>/dev/null
}

# è§£æGTIDæ•°é‡
parse_gtid_count() {
    local gtid_set=$1
    if [[ -z "$gtid_set" ]]; then
        echo 0
        return
    fi
    
    # ç®€åŒ–ç‰ˆè§£æï¼ˆå®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤æ‚çš„è§£æé€»è¾‘ï¼‰
    echo "$gtid_set" | grep -o '[0-9]\+-[0-9]\+' | while read range; do
        start=$(echo $range | cut -d'-' -f1)
        end=$(echo $range | cut -d'-' -f2)
        echo $((end - start + 1))
    done | awk '{sum+=$1} END {print sum}'
}

# æ‰§è¡Œæ£€æŸ¥
echo "ğŸ“Š å¼€å§‹GTIDä¸€è‡´æ€§æ£€æŸ¥..."

MASTER_GTID=$(get_gtid_executed $MASTER_HOST)
SLAVE_GTID=$(get_gtid_executed $SLAVE_HOST)

MASTER_COUNT=$(parse_gtid_count "$MASTER_GTID")
SLAVE_COUNT=$(parse_gtid_count "$SLAVE_GTID")

echo "ä¸»åº“GTIDæ•°é‡: $MASTER_COUNT"
echo "ä»åº“GTIDæ•°é‡: $SLAVE_COUNT"

DIFF=$((MASTER_COUNT - SLAVE_COUNT))
echo "å·®å¼‚æ•°é‡: $DIFF"

# å‘Šè­¦åˆ¤æ–­
if [[ $DIFF -gt 1000 ]]; then
    echo "ğŸš¨ ä¸¥é‡å‘Šè­¦ï¼šä¸»ä»GTIDå·®å¼‚è¿‡å¤§ ($DIFF)"
    exit 2
elif [[ $DIFF -gt 100 ]]; then
    echo "âš ï¸ è­¦å‘Šï¼šä¸»ä»GTIDå­˜åœ¨è¾ƒå¤§å·®å¼‚ ($DIFF)"
    exit 1
else
    echo "âœ… æ­£å¸¸ï¼šä¸»ä»GTIDåŸºæœ¬ä¸€è‡´"
    exit 0
fi
```

---

## 3. ğŸ” ä¸€è‡´æ€§æ£€æŸ¥æ–¹æ³•


### 3.1 åŸºç¡€ä¸€è‡´æ€§æ£€æŸ¥


**æ•°æ®çº§ä¸€è‡´æ€§æ£€æŸ¥**æ˜¯ç¡®ä¿ä¸»ä»æ•°æ®åº“æ•°æ®å®Œå…¨ç›¸åŒçš„éªŒè¯è¿‡ç¨‹ã€‚

#### ğŸ¯ æ£€æŸ¥ç­–ç•¥


```
æ£€æŸ¥å±‚æ¬¡ï¼š
1ï¸âƒ£ GTIDé›†åˆä¸€è‡´æ€§ â† æœ€åŸºç¡€
2ï¸âƒ£ è¡¨ç»“æ„ä¸€è‡´æ€§ â† ç»“æ„å±‚é¢  
3ï¸âƒ£ æ•°æ®å†…å®¹ä¸€è‡´æ€§ â† æ•°æ®å±‚é¢
4ï¸âƒ£ ç´¢å¼•çŠ¶æ€ä¸€è‡´æ€§ â† æ€§èƒ½å±‚é¢
```

#### ğŸ“‹ æ£€æŸ¥æ¸…å•


**GTIDå±‚é¢æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥GTIDæ‰§è¡ŒçŠ¶æ€
SELECT 
    'Master' as server_type,
    $$global.gtid_executed as gtid_executed,
    $$global.gtid_purged as gtid_purged
UNION ALL
-- åœ¨ä»åº“ä¸Šæ‰§è¡Œç›¸åŒæŸ¥è¯¢è¿›è¡Œå¯¹æ¯”
```

**è¡¨ç»“æ„ä¸€è‡´æ€§**ï¼š
```sql
-- è·å–è¡¨ç»“æ„æ ¡éªŒç 
SELECT 
    table_schema,
    table_name,
    CHECKSUM TABLE table_name
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'sys');
```

### 3.2 é«˜çº§ä¸€è‡´æ€§æ£€æŸ¥å·¥å…·


#### ğŸ› ï¸ pt-table-checksum ä½¿ç”¨


**pt-table-checksum**æ˜¯Perconaæä¾›çš„ä¸“ä¸šæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å·¥å…·ã€‚

```bash
# åŸºç¡€ä½¿ç”¨æ–¹æ³•
pt-table-checksum \
    --host=master_host \
    --user=checksum_user \
    --password=password \
    --databases=your_database \
    --replicate=percona.checksums

# é«˜çº§å‚æ•°é…ç½®
pt-table-checksum \
    --host=192.168.1.10 \
    --user=checksum \
    --password=checksum123 \
    --databases=ecommerce,users \
    --replicate=percona.checksums \
    --chunk-size=1000 \
    --max-load="Threads_running=50" \
    --check-interval=5 \
    --recursion-method=dsn=D=percona,t=dsns
```

**ğŸ’¡ å‚æ•°è¯´æ˜**ï¼š
- `--chunk-size=1000`ï¼šæ¯æ¬¡æ£€æŸ¥1000è¡Œï¼Œé¿å…é•¿æ—¶é—´é”è¡¨
- `--max-load`ï¼šç³»ç»Ÿè´Ÿè½½è¿‡é«˜æ—¶æš‚åœæ£€æŸ¥
- `--check-interval=5`ï¼šæ¯5ç§’æ£€æŸ¥ä¸€æ¬¡ç³»ç»Ÿè´Ÿè½½

#### ğŸ“Š æ£€æŸ¥ç»“æœåˆ†æ


```sql
-- æŸ¥çœ‹æ£€æŸ¥ç»“æœ
SELECT 
    db,
    tbl,
    chunk,
    boundaries,
    this_crc,
    master_crc,
    CASE 
        WHEN this_crc = master_crc THEN 'âœ… ä¸€è‡´'
        ELSE 'âŒ ä¸ä¸€è‡´'
    END as status
FROM percona.checksums 
WHERE master_crc IS NOT NULL
ORDER BY db, tbl, chunk;
```

### 3.3 å®æ—¶ä¸€è‡´æ€§ç›‘æ§


#### âš¡ å®æ—¶ç›‘æ§æ¶æ„


```
åº”ç”¨å±‚
    â†“ å†™å…¥
ä¸»åº“ MySQL Master
    â†“ å¤åˆ¶ (å¼‚æ­¥/åŠåŒæ­¥)
ä»åº“ MySQL Slave
    â†“ å®šæœŸæ£€æŸ¥
ç›‘æ§ç³»ç»Ÿ
    â†“ å‘ç°ä¸ä¸€è‡´
å‘Šè­¦ç³»ç»Ÿ
    â†“ é€šçŸ¥
è¿ç»´äººå‘˜
```

#### ğŸ”„ è‡ªåŠ¨åŒ–æ£€æŸ¥æµç¨‹


```python
#!/usr/bin/env python3
# å®æ—¶ä¸€è‡´æ€§ç›‘æ§è„šæœ¬

import threading
import time
import hashlib
from datetime import datetime

class RealtimeConsistencyMonitor:
    def __init__(self, master_config, slave_config):
        self.master_config = master_config
        self.slave_config = slave_config
        self.check_interval = 60  # æ£€æŸ¥é—´éš”60ç§’
        self.running = True
        
    def get_table_checksum(self, config, table_name):
        """è·å–è¡¨çš„æ ¡éªŒå’Œ"""
        # è¿™é‡Œç®€åŒ–å®ç°ï¼Œå®é™…åº”è¯¥ä½¿ç”¨æ›´å¤æ‚çš„æ ¡éªŒé€»è¾‘
        conn = mysql.connector.connect(**config)
        cursor = conn.cursor()
        
        # è·å–è¡¨çš„è¡Œæ•°å’Œæœ€åæ›´æ–°æ—¶é—´
        cursor.execute(f"""
            SELECT 
                COUNT(*),
                COALESCE(MAX(update_time), MAX(create_time), NOW())
            FROM {table_name}
        """)
        result = cursor.fetchone()
        
        # ç”Ÿæˆç®€å•æ ¡éªŒç 
        checksum = hashlib.md5(str(result).encode()).hexdigest()
        conn.close()
        return checksum
    
    def check_table_consistency(self, table_name):
        """æ£€æŸ¥ç‰¹å®šè¡¨çš„ä¸€è‡´æ€§"""
        try:
            master_checksum = self.get_table_checksum(self.master_config, table_name)
            slave_checksum = self.get_table_checksum(self.slave_config, table_name)
            
            if master_checksum != slave_checksum:
                self.send_alert(f"è¡¨ {table_name} æ•°æ®ä¸ä¸€è‡´ï¼")
                return False
            return True
        except Exception as e:
            self.send_alert(f"æ£€æŸ¥è¡¨ {table_name} æ—¶å‡ºé”™: {e}")
            return False
    
    def send_alert(self, message):
        """å‘é€å‘Šè­¦"""
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        print(f"ğŸš¨ [{timestamp}] ä¸€è‡´æ€§å‘Šè­¦: {message}")
        # è¿™é‡Œå¯ä»¥é›†æˆçŸ­ä¿¡ã€é‚®ä»¶ã€é’‰é’‰ç­‰å‘Šè­¦æ–¹å¼
    
    def monitor_loop(self):
        """ç›‘æ§ä¸»å¾ªç¯"""
        critical_tables = ['users', 'orders', 'payments']  # å…³é”®è¡¨åˆ—è¡¨
        
        while self.running:
            print(f"ğŸ“Š [{datetime.now()}] å¼€å§‹ä¸€è‡´æ€§æ£€æŸ¥...")
            
            all_consistent = True
            for table in critical_tables:
                if not self.check_table_consistency(table):
                    all_consistent = False
            
            if all_consistent:
                print("âœ… æ‰€æœ‰å…³é”®è¡¨æ•°æ®ä¸€è‡´")
            
            time.sleep(self.check_interval)

# ä½¿ç”¨ç¤ºä¾‹
master_config = {
    'host': '192.168.1.10',
    'user': 'monitor',
    'password': 'password',
    'database': 'ecommerce'
}

slave_config = {
    'host': '192.168.1.11', 
    'user': 'monitor',
    'password': 'password',
    'database': 'ecommerce'
}

monitor = RealtimeConsistencyMonitor(master_config, slave_config)
# monitor.monitor_loop()  # å¯åŠ¨ç›‘æ§
```

---

## 4. ğŸ›¡ï¸ æ•°æ®å®Œæ•´æ€§éªŒè¯


### 4.1 ä»€ä¹ˆæ˜¯æ•°æ®å®Œæ•´æ€§éªŒè¯


**æ•°æ®å®Œæ•´æ€§éªŒè¯**å°±æ˜¯ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“å’Œå­˜å‚¨è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸¢å¤±ã€æŸåæˆ–è¢«æ„å¤–ä¿®æ”¹ã€‚

```
å®Œæ•´æ€§éªŒè¯çš„ç»´åº¦ï¼š

ğŸ“Š æ•°é‡å®Œæ•´æ€§
ä¸»åº“æœ‰1000æ¡è®°å½• â†’ ä»åº“ä¹Ÿåº”è¯¥æœ‰1000æ¡è®°å½•

ğŸ” å†…å®¹å®Œæ•´æ€§  
ç”¨æˆ·ID=123çš„è´¦æˆ·ä½™é¢åœ¨ä¸»åº“æ˜¯1000å…ƒ â†’ ä»åº“ä¹Ÿåº”è¯¥æ˜¯1000å…ƒ

â° æ—¶åºå®Œæ•´æ€§
æ“ä½œAå‘ç”Ÿåœ¨æ“ä½œBä¹‹å‰ â†’ ä»åº“ä¸­ä¹Ÿåº”è¯¥ä¿æŒè¿™ä¸ªé¡ºåº

ğŸ—ï¸ ç»“æ„å®Œæ•´æ€§
ä¸»åº“çš„è¡¨ç»“æ„ â†’ ä»åº“çš„è¡¨ç»“æ„åº”è¯¥å®Œå…¨ä¸€è‡´
```

### 4.2 æ•°æ®å®Œæ•´æ€§æ£€æŸ¥æ–¹æ³•


#### ğŸ”¢ æ•°é‡çº§æ£€æŸ¥


```sql
-- å¿«é€Ÿæ•°é‡æ£€æŸ¥ï¼ˆé€‚ç”¨äºå¤§è¡¨ï¼‰
SELECT 
    'master' as server,
    COUNT(*) as total_rows,
    MAX(id) as max_id,
    MIN(id) as min_id
FROM critical_table
UNION ALL
-- åœ¨ä»åº“æ‰§è¡Œç›¸åŒæŸ¥è¯¢

-- åˆ†æ—¶æ®µæ•°é‡æ£€æŸ¥ï¼ˆé€‚ç”¨äºæœ‰æ—¶é—´å­—æ®µçš„è¡¨ï¼‰
SELECT 
    DATE(created_at) as date,
    COUNT(*) as daily_count
FROM orders 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY DATE(created_at)
ORDER BY date;
```

#### ğŸ” æŠ½æ ·å†…å®¹æ£€æŸ¥


```sql
-- éšæœºæŠ½æ ·æ£€æŸ¥ï¼ˆæ£€æŸ¥æ•°æ®å†…å®¹ï¼‰
SELECT 
    id,
    MD5(CONCAT(user_id, amount, status, created_at)) as row_checksum
FROM orders 
WHERE id IN (
    SELECT id FROM orders 
    ORDER BY RAND() 
    LIMIT 100
)
ORDER BY id;
```

#### âš¡ å¢é‡æ£€æŸ¥ç­–ç•¥


```python
# å¢é‡æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
class IncrementalIntegrityChecker:
    def __init__(self, master_conn, slave_conn):
        self.master_conn = master_conn
        self.slave_conn = slave_conn
    
    def check_recent_data(self, table_name, minutes=10):
        """æ£€æŸ¥æœ€è¿‘Nåˆ†é’Ÿçš„æ•°æ®"""
        
        # è·å–æœ€è¿‘æ•°æ®çš„æ ¡éªŒä¿¡æ¯
        query = f"""
        SELECT 
            COUNT(*) as row_count,
            SUM(CRC32(CONCAT_WS('|', *))) as content_checksum,
            MAX(update_time) as latest_update
        FROM {table_name}
        WHERE update_time >= DATE_SUB(NOW(), INTERVAL {minutes} MINUTE)
        """
        
        # æ‰§è¡Œæ£€æŸ¥
        master_result = self.execute_query(self.master_conn, query)
        slave_result = self.execute_query(self.slave_conn, query)
        
        # æ¯”è¾ƒç»“æœ
        if master_result != slave_result:
            return {
                'status': 'inconsistent',
                'master': master_result,
                'slave': slave_result,
                'message': f'è¡¨ {table_name} æœ€è¿‘ {minutes} åˆ†é’Ÿæ•°æ®ä¸ä¸€è‡´'
            }
        
        return {
            'status': 'consistent',
            'checked_rows': master_result[0],
            'message': f'è¡¨ {table_name} æœ€è¿‘ {minutes} åˆ†é’Ÿæ•°æ®ä¸€è‡´'
        }
```

### 4.3 ä¸šåŠ¡çº§å®Œæ•´æ€§éªŒè¯


#### ğŸ’¼ ä¸šåŠ¡è§„åˆ™éªŒè¯


```sql
-- è´¦æˆ·ä½™é¢ä¸€è‡´æ€§æ£€æŸ¥
SELECT 
    user_id,
    (
        SELECT balance FROM user_accounts WHERE user_id = t.user_id
    ) as current_balance,
    (
        SELECT 
            COALESCE(SUM(CASE WHEN type='income' THEN amount ELSE -amount END), 0)
        FROM transactions 
        WHERE user_id = t.user_id
    ) as calculated_balance
FROM (
    SELECT DISTINCT user_id FROM user_accounts LIMIT 100
) t
HAVING current_balance != calculated_balance;
```

#### ğŸ“ˆ ä¸šåŠ¡æŒ‡æ ‡éªŒè¯


```sql
-- æ—¥è®¢å•ç»Ÿè®¡ä¸€è‡´æ€§æ£€æŸ¥
SELECT 
    'ä¸»åº“ç»Ÿè®¡' as source,
    DATE(created_at) as order_date,
    COUNT(*) as order_count,
    SUM(total_amount) as total_amount
FROM orders 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 3 DAY)
GROUP BY DATE(created_at)

UNION ALL

SELECT 
    'æŠ¥è¡¨ç»Ÿè®¡' as source,
    report_date as order_date,
    order_count,
    total_amount  
FROM daily_order_summary
WHERE report_date >= DATE_SUB(NOW(), INTERVAL 3 DAY)
ORDER BY order_date, source;
```

---

## 5. ğŸ“ˆ ç›‘æ§æŒ‡æ ‡ä¸å‘Šè­¦


### 5.1 GTIDå…³é”®ç›‘æ§æŒ‡æ ‡


#### ğŸ¯ æ ¸å¿ƒæŒ‡æ ‡å®šä¹‰


**ğŸ“Š GTIDæ•°é‡æŒ‡æ ‡**ï¼š
```
æŒ‡æ ‡åç§°ï¼šgtid_executed_count
å«ä¹‰ï¼šå½“å‰å·²æ‰§è¡Œçš„GTIDæ€»æ•°é‡
è®¡ç®—æ–¹æ³•ï¼šè§£æ $$global.gtid_executed é›†åˆä¸­çš„äº‹åŠ¡æ•°é‡
æ­£å¸¸èŒƒå›´ï¼šæŒç»­å¢é•¿ï¼Œå¢é•¿é€Ÿåº¦ä¸ä¸šåŠ¡å†™å…¥é¢‘ç‡åŒ¹é…
å‘Šè­¦æ¡ä»¶ï¼š
  - åœæ­¢å¢é•¿è¶…è¿‡5åˆ†é’Ÿï¼ˆå¯èƒ½å¤åˆ¶ä¸­æ–­ï¼‰
  - å¢é•¿é€Ÿåº¦å¼‚å¸¸ï¼ˆçªç„¶æš´å¢æˆ–æš´å‡ï¼‰
```

**â±ï¸ å¤åˆ¶å»¶è¿ŸæŒ‡æ ‡**ï¼š
```
æŒ‡æ ‡åç§°ï¼šgtid_replication_lag
å«ä¹‰ï¼šä¸»ä»ä¹‹é—´çš„GTIDå·®å¼‚æ•°é‡
è®¡ç®—æ–¹æ³•ï¼šä¸»åº“gtid_executedæ•°é‡ - ä»åº“gtid_executedæ•°é‡  
æ­£å¸¸èŒƒå›´ï¼š<100ä¸ªäº‹åŠ¡
å‘Šè­¦çº§åˆ«ï¼š
  - è­¦å‘Šï¼š100-1000ä¸ªäº‹åŠ¡
  - ä¸¥é‡ï¼š1000-10000ä¸ªäº‹åŠ¡
  - ç´§æ€¥ï¼š>10000ä¸ªäº‹åŠ¡
```

**ğŸ”„ GTIDå¢é•¿ç‡æŒ‡æ ‡**ï¼š
```
æŒ‡æ ‡åç§°ï¼šgtid_growth_rate
å«ä¹‰ï¼šæ¯ç§’æ–°å¢çš„GTIDæ•°é‡
è®¡ç®—æ–¹æ³•ï¼š(å½“å‰GTIDæ•°é‡ - ä¸Šæ¬¡GTIDæ•°é‡) / æ—¶é—´é—´éš”
ä¸šåŠ¡æ„ä¹‰ï¼šåæ˜ æ•°æ®åº“å†™å…¥æ´»è·ƒç¨‹åº¦
ç›‘æ§ç”¨é€”ï¼š
  - å®¹é‡è§„åˆ’å‚è€ƒ
  - æ€§èƒ½å¼‚å¸¸æ£€æµ‹
  - å¤åˆ¶å‹åŠ›è¯„ä¼°
```

#### ğŸ“‹ ç›‘æ§æŒ‡æ ‡æ”¶é›†è„šæœ¬


```python
#!/usr/bin/env python3
# GTIDç›‘æ§æŒ‡æ ‡æ”¶é›†å™¨

import mysql.connector
import time
import json
from datetime import datetime

class GTIDMetricsCollector:
    def __init__(self, db_configs):
        self.db_configs = db_configs
        self.metrics_history = {}
        
    def parse_gtid_set(self, gtid_set):
        """è§£æGTIDé›†åˆï¼Œè¿”å›æ€»äº‹åŠ¡æ•°é‡"""
        if not gtid_set:
            return 0
            
        total = 0
        # è§£ææ ¼å¼ï¼šserver_uuid:1-1000,server_uuid:1001-2000
        for segment in gtid_set.split(','):
            if ':' not in segment:
                continue
                
            uuid, ranges = segment.split(':', 1)
            for range_part in ranges.split(':'):
                if '-' in range_part:
                    start, end = map(int, range_part.split('-'))
                    total += (end - start + 1)
                else:
                    total += 1
        return total
    
    def collect_server_metrics(self, server_name, config):
        """æ”¶é›†å•ä¸ªæœåŠ¡å™¨çš„GTIDæŒ‡æ ‡"""
        try:
            conn = mysql.connector.connect(**config)
            cursor = conn.cursor()
            
            # è·å–GTIDç›¸å…³ä¿¡æ¯
            cursor.execute("""
                SELECT 
                    $$global.gtid_executed as gtid_executed,
                    $$global.gtid_purged as gtid_purged,
                    $$global.gtid_owned as gtid_owned
            """)
            result = cursor.fetchone()
            
            # è·å–å¤åˆ¶çŠ¶æ€ï¼ˆä»…ä»åº“ï¼‰
            replication_info = {}
            try:
                cursor.execute("SHOW SLAVE STATUS")
                slave_status = cursor.fetchone()
                if slave_status:
                    replication_info = {
                        'slave_io_running': slave_status[10],  # Slave_IO_Running
                        'slave_sql_running': slave_status[11], # Slave_SQL_Running
                        'seconds_behind_master': slave_status[32] # Seconds_Behind_Master
                    }
            except:
                pass  # ä¸»åº“æ²¡æœ‰slave status
            
            conn.close()
            
            # è§£æGTIDæ•°é‡
            gtid_executed_count = self.parse_gtid_set(result[0])
            gtid_purged_count = self.parse_gtid_set(result[1])
            
            # è®¡ç®—å¢é•¿ç‡
            current_time = time.time()
            growth_rate = 0
            
            if server_name in self.metrics_history:
                last_metrics = self.metrics_history[server_name]
                time_diff = current_time - last_metrics['timestamp']
                count_diff = gtid_executed_count - last_metrics['gtid_executed_count']
                if time_diff > 0:
                    growth_rate = count_diff / time_diff
            
            # æ„å»ºæŒ‡æ ‡æ•°æ®
            metrics = {
                'timestamp': current_time,
                'server_name': server_name,
                'gtid_executed_count': gtid_executed_count,
                'gtid_purged_count': gtid_purged_count,
                'gtid_growth_rate': growth_rate,
                'replication_info': replication_info
            }
            
            # ä¿å­˜å†å²æ•°æ®
            self.metrics_history[server_name] = metrics
            
            return metrics
            
        except Exception as e:
            return {'error': str(e), 'server_name': server_name}
    
    def collect_all_metrics(self):
        """æ”¶é›†æ‰€æœ‰æœåŠ¡å™¨çš„æŒ‡æ ‡"""
        all_metrics = []
        
        for server_name, config in self.db_configs.items():
            metrics = self.collect_server_metrics(server_name, config)
            all_metrics.append(metrics)
        
        return all_metrics
    
    def calculate_replication_lag(self, master_metrics, slave_metrics):
        """è®¡ç®—ä¸»ä»å¤åˆ¶å»¶è¿Ÿï¼ˆGTIDæ•°é‡å·®å¼‚ï¼‰"""
        if 'error' in master_metrics or 'error' in slave_metrics:
            return None
            
        master_count = master_metrics['gtid_executed_count']
        slave_count = slave_metrics['gtid_executed_count']
        
        return master_count - slave_count

# ä½¿ç”¨ç¤ºä¾‹
db_configs = {
    'master': {
        'host': '192.168.1.10',
        'user': 'monitor',
        'password': 'password',
        'database': 'mysql'
    },
    'slave1': {
        'host': '192.168.1.11',
        'user': 'monitor', 
        'password': 'password',
        'database': 'mysql'
    }
}

collector = GTIDMetricsCollector(db_configs)

# å®šæœŸæ”¶é›†æŒ‡æ ‡
while True:
    metrics = collector.collect_all_metrics()
    
    # è¾“å‡ºæŒ‡æ ‡ï¼ˆå®é™…åº”ç”¨ä¸­åº”è¯¥å‘é€åˆ°ç›‘æ§ç³»ç»Ÿï¼‰
    for metric in metrics:
        print(f"ğŸ“Š {metric['server_name']}: GTIDæ‰§è¡Œæ•°é‡={metric.get('gtid_executed_count', 'N/A')}")
    
    time.sleep(30)  # æ¯30ç§’æ”¶é›†ä¸€æ¬¡
```

### 5.2 å‘Šè­¦ç­–ç•¥è®¾è®¡


#### ğŸš¨ åˆ†çº§å‘Šè­¦æœºåˆ¶


**ğŸ“Š å‘Šè­¦çº§åˆ«å®šä¹‰**ï¼š

| çº§åˆ« | **è§¦å‘æ¡ä»¶** | **å“åº”æ—¶é—´** | **é€šçŸ¥æ–¹å¼** | **å¤„ç†è¦æ±‚** |
|------|-------------|-------------|-------------|-------------|
| `ğŸŸ¢ ä¿¡æ¯` | `GTIDå¢é•¿ç‡å˜åŒ–>20%` | `æ— è¦æ±‚` | `ç³»ç»Ÿè®°å½•` | `å…³æ³¨å³å¯` |
| `ğŸŸ¡ è­¦å‘Š` | `ä¸»ä»GTIDå·®å¼‚>100` | `30åˆ†é’Ÿå†…` | `é‚®ä»¶é€šçŸ¥` | `å®‰æ’æ£€æŸ¥` |
| `ğŸŸ  ä¸¥é‡` | `ä¸»ä»GTIDå·®å¼‚>1000` | `15åˆ†é’Ÿå†…` | `çŸ­ä¿¡+é‚®ä»¶` | `ç«‹å³å¤„ç†` |
| `ğŸ”´ ç´§æ€¥` | `å¤åˆ¶å®Œå…¨ä¸­æ–­` | `5åˆ†é’Ÿå†…` | `ç”µè¯+çŸ­ä¿¡+é‚®ä»¶` | `ç´§æ€¥ä¿®å¤` |

#### âš¡ æ™ºèƒ½å‘Šè­¦è§„åˆ™


```python
class GTIDAlertManager:
    def __init__(self):
        self.alert_rules = {
            'replication_lag': {
                'warning': 100,
                'critical': 1000, 
                'emergency': 10000
            },
            'growth_rate_change': {
                'warning': 0.5,  # å¢é•¿ç‡å˜åŒ–50%
                'critical': 0.8  # å¢é•¿ç‡å˜åŒ–80%
            },
            'replication_stop': {
                'emergency': 300  # å¤åˆ¶åœæ­¢5åˆ†é’Ÿ
            }
        }
    
    def evaluate_alerts(self, current_metrics, historical_metrics):
        """è¯„ä¼°å‘Šè­¦æ¡ä»¶"""
        alerts = []
        
        # æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
        for metric in current_metrics:
            if metric['server_name'] != 'master':
                lag = self.calculate_lag(current_metrics, metric['server_name'])
                
                if lag >= self.alert_rules['replication_lag']['emergency']:
                    alerts.append({
                        'level': 'emergency',
                        'type': 'replication_lag',
                        'message': f"ä»åº“ {metric['server_name']} ä¸¥é‡å»¶è¿Ÿ: {lag} ä¸ªäº‹åŠ¡",
                        'server': metric['server_name'],
                        'value': lag
                    })
                elif lag >= self.alert_rules['replication_lag']['critical']:
                    alerts.append({
                        'level': 'critical', 
                        'type': 'replication_lag',
                        'message': f"ä»åº“ {metric['server_name']} å»¶è¿Ÿè¾ƒå¤§: {lag} ä¸ªäº‹åŠ¡",
                        'server': metric['server_name'],
                        'value': lag
                    })
        
        # æ£€æŸ¥å¢é•¿ç‡å¼‚å¸¸
        for metric in current_metrics:
            if metric['server_name'] in historical_metrics:
                current_rate = metric['gtid_growth_rate']
                historical_rate = historical_metrics[metric['server_name']]['avg_growth_rate']
                
                if historical_rate > 0:
                    change_ratio = abs(current_rate - historical_rate) / historical_rate
                    
                    if change_ratio >= self.alert_rules['growth_rate_change']['critical']:
                        alerts.append({
                            'level': 'critical',
                            'type': 'growth_rate_anomaly', 
                            'message': f"æœåŠ¡å™¨ {metric['server_name']} GTIDå¢é•¿ç‡å¼‚å¸¸å˜åŒ– {change_ratio:.1%}",
                            'server': metric['server_name'],
                            'value': change_ratio
                        })
        
        return alerts
    
    def send_alert(self, alert):
        """å‘é€å‘Šè­¦é€šçŸ¥"""
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        # æ ¹æ®çº§åˆ«é€‰æ‹©é€šçŸ¥æ–¹å¼
        if alert['level'] == 'emergency':
            print(f"ğŸ”´ [{timestamp}] ç´§æ€¥å‘Šè­¦: {alert['message']}")
            # è¿™é‡Œåº”è¯¥è°ƒç”¨ç”µè¯ã€çŸ­ä¿¡ã€é‚®ä»¶é€šçŸ¥
        elif alert['level'] == 'critical':
            print(f"ğŸŸ  [{timestamp}] ä¸¥é‡å‘Šè­¦: {alert['message']}")
            # è¿™é‡Œåº”è¯¥è°ƒç”¨çŸ­ä¿¡ã€é‚®ä»¶é€šçŸ¥
        elif alert['level'] == 'warning':
            print(f"ğŸŸ¡ [{timestamp}] è­¦å‘Š: {alert['message']}")
            # è¿™é‡Œåº”è¯¥è°ƒç”¨é‚®ä»¶é€šçŸ¥
```

---

## 6. ğŸ¤– è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·


### 6.1 è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬å¼€å‘


**è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·**æ˜¯å°†æ‰‹å·¥æ£€æŸ¥è¿‡ç¨‹ç¨‹åºåŒ–ï¼Œå®ç°å®šæ—¶ã€æ‰¹é‡ã€æ™ºèƒ½çš„æ•°æ®åº“å¥åº·æ£€æŸ¥ã€‚

#### ğŸ› ï¸ å…¨åŠŸèƒ½æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# MySQL GTID å…¨é¢å¥åº·æ£€æŸ¥è„šæœ¬
# åŠŸèƒ½ï¼šGTIDçŠ¶æ€æ£€æŸ¥ã€ä¸€è‡´æ€§éªŒè¯ã€æ€§èƒ½ç›‘æ§

# é…ç½®åŒºåŸŸ
CONFIG_FILE="/etc/mysql-monitor/config.conf"
LOG_FILE="/var/log/mysql-monitor/gtid-check.log" 
ALERT_WEBHOOK="https://your-alert-system.com/webhook"

# åŠ è½½é…ç½®
source $CONFIG_FILE

# æ—¥å¿—å‡½æ•°
log_message() {
    local level=$1
    local message=$2
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$timestamp] [$level] $message" | tee -a $LOG_FILE
}

# GTIDçŠ¶æ€æ£€æŸ¥å‡½æ•°
check_gtid_status() {
    local host=$1
    local server_name=$2
    
    log_message "INFO" "å¼€å§‹æ£€æŸ¥ $server_name GTIDçŠ¶æ€..."
    
    # è·å–GTIDä¿¡æ¯
    local gtid_info=$(mysql -h$host -u$MYSQL_USER -p$MYSQL_PASS -se "
        SELECT 
            $$global.gtid_executed,
            $$global.gtid_purged,
            $$global.gtid_owned
    " 2>/dev/null)
    
    if [[ $? -ne 0 ]]; then
        log_message "ERROR" "$server_name è¿æ¥å¤±è´¥"
        return 1
    fi
    
    local gtid_executed=$(echo "$gtid_info" | awk 'NR==1{print $1}')
    local gtid_purged=$(echo "$gtid_info" | awk 'NR==1{print $2}')
    local gtid_owned=$(echo "$gtid_info" | awk 'NR==1{print $3}')
    
    log_message "INFO" "$server_name GTIDæ‰§è¡Œé›†åˆ: $gtid_executed"
    log_message "INFO" "$server_name GTIDæ¸…ç†é›†åˆ: $gtid_purged"
    
    # æ£€æŸ¥GTIDæ˜¯å¦æ­£å¸¸å¢é•¿
    local current_count=$(parse_gtid_count "$gtid_executed")
    local last_count_file="/tmp/gtid_count_${server_name}.tmp"
    
    if [[ -f $last_count_file ]]; then
        local last_count=$(cat $last_count_file)
        local growth=$((current_count - last_count))
        
        if [[ $growth -eq 0 ]] && [[ $server_name == "master" ]]; then
            log_message "WARNING" "$server_name GTIDåœæ­¢å¢é•¿ï¼Œå¯èƒ½å­˜åœ¨é—®é¢˜"
            send_alert "WARNING" "$server_name GTIDåœæ­¢å¢é•¿"
        elif [[ $growth -lt 0 ]]; then
            log_message "ERROR" "$server_name GTIDæ•°é‡å‡å°‘ï¼Œä¸¥é‡å¼‚å¸¸ï¼"
            send_alert "CRITICAL" "$server_name GTIDæ•°é‡å¼‚å¸¸å‡å°‘"
        else
            log_message "INFO" "$server_name GTIDæ­£å¸¸å¢é•¿: +$growth"
        fi
    fi
    
    # ä¿å­˜å½“å‰è®¡æ•°
    echo $current_count > $last_count_file
    
    return 0
}

# ä¸»ä»ä¸€è‡´æ€§æ£€æŸ¥
check_master_slave_consistency() {
    log_message "INFO" "å¼€å§‹ä¸»ä»ä¸€è‡´æ€§æ£€æŸ¥..."
    
    # è·å–ä¸»åº“GTID
    local master_gtid=$(mysql -h$MASTER_HOST -u$MYSQL_USER -p$MYSQL_PASS -se "SELECT $$global.gtid_executed" 2>/dev/null)
    local master_count=$(parse_gtid_count "$master_gtid")
    
    # æ£€æŸ¥æ‰€æœ‰ä»åº“
    for slave_host in $SLAVE_HOSTS; do
        local slave_gtid=$(mysql -h$slave_host -u$MYSQL_USER -p$MYSQL_PASS -se "SELECT $$global.gtid_executed" 2>/dev/null)
        local slave_count=$(parse_gtid_count "$slave_gtid")
        
        local lag=$((master_count - slave_count))
        
        log_message "INFO" "ä»åº“ $slave_host å»¶è¿Ÿ: $lag ä¸ªäº‹åŠ¡"
        
        # å»¶è¿Ÿå‘Šè­¦åˆ¤æ–­
        if [[ $lag -gt 1000 ]]; then
            log_message "CRITICAL" "ä»åº“ $slave_host ä¸¥é‡å»¶è¿Ÿ: $lag"
            send_alert "CRITICAL" "ä»åº“ $slave_host å»¶è¿Ÿ $lag ä¸ªäº‹åŠ¡"
        elif [[ $lag -gt 100 ]]; then
            log_message "WARNING" "ä»åº“ $slave_host å»¶è¿Ÿè¾ƒå¤§: $lag" 
            send_alert "WARNING" "ä»åº“ $slave_host å»¶è¿Ÿ $lag ä¸ªäº‹åŠ¡"
        fi
    done
}

# æ•°æ®å®Œæ•´æ€§æŠ½æ ·æ£€æŸ¥
check_data_integrity() {
    log_message "INFO" "å¼€å§‹æ•°æ®å®Œæ•´æ€§æŠ½æ ·æ£€æŸ¥..."
    
    # å…³é”®è¡¨åˆ—è¡¨
    local critical_tables=("users" "orders" "payments" "user_accounts")
    
    for table in "${critical_tables[@]}"; do
        log_message "INFO" "æ£€æŸ¥è¡¨: $table"
        
        # è·å–ä¸»åº“è¡¨ç»Ÿè®¡
        local master_stats=$(mysql -h$MASTER_HOST -u$MYSQL_USER -p$MYSQL_PASS -se "
            SELECT COUNT(*), COALESCE(MAX(id), 0), COALESCE(MIN(id), 0) 
            FROM $table
        " 2>/dev/null)
        
        if [[ $? -ne 0 ]]; then
            log_message "WARNING" "æ— æ³•æ£€æŸ¥è¡¨ $tableï¼Œå¯èƒ½ä¸å­˜åœ¨"
            continue
        fi
        
        # æ£€æŸ¥ä»åº“
        for slave_host in $SLAVE_HOSTS; do
            local slave_stats=$(mysql -h$slave_host -u$MYSQL_USER -p$MYSQL_PASS -se "
                SELECT COUNT(*), COALESCE(MAX(id), 0), COALESCE(MIN(id), 0) 
                FROM $table
            " 2>/dev/null)
            
            if [[ "$master_stats" != "$slave_stats" ]]; then
                log_message "CRITICAL" "è¡¨ $table åœ¨ä»åº“ $slave_host æ•°æ®ä¸ä¸€è‡´"
                log_message "INFO" "ä¸»åº“ç»Ÿè®¡: $master_stats"
                log_message "INFO" "ä»åº“ç»Ÿè®¡: $slave_stats" 
                send_alert "CRITICAL" "è¡¨ $table ä¸»ä»æ•°æ®ä¸ä¸€è‡´"
            else
                log_message "INFO" "è¡¨ $table åœ¨ä»åº“ $slave_host æ•°æ®ä¸€è‡´"
            fi
        done
    done
}

# å‘Šè­¦å‘é€å‡½æ•°
send_alert() {
    local level=$1
    local message=$2
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # å‘é€åˆ°å‘Šè­¦ç³»ç»Ÿ
    curl -X POST $ALERT_WEBHOOK \
        -H "Content-Type: application/json" \
        -d "{
            \"level\": \"$level\",
            \"message\": \"$message\",
            \"timestamp\": \"$timestamp\",
            \"source\": \"MySQL GTID Monitor\"
        }" >/dev/null 2>&1
    
    log_message "INFO" "å‘Šè­¦å·²å‘é€: [$level] $message"
}

# GTIDè®¡æ•°è§£æå‡½æ•°
parse_gtid_count() {
    local gtid_set=$1
    if [[ -z "$gtid_set" || "$gtid_set" == "NULL" ]]; then
        echo 0
        return
    fi
    
    # ç®€åŒ–çš„GTIDè®¡æ•°é€»è¾‘
    echo "$gtid_set" | grep -o '[0-9]\+-[0-9]\+' | while read range; do
        local start=$(echo $range | cut -d'-' -f1)
        local end=$(echo $range | cut -d'-' -f2)
        echo $((end - start + 1))
    done | awk '{sum+=$1} END {print (NR==0) ? 0 : sum}'
}

# ä¸»å‡½æ•°
main() {
    log_message "INFO" "======== MySQL GTID å¥åº·æ£€æŸ¥å¼€å§‹ ========"
    
    # æ£€æŸ¥ä¸»åº“GTIDçŠ¶æ€
    check_gtid_status $MASTER_HOST "master"
    
    # æ£€æŸ¥ä»åº“GTIDçŠ¶æ€
    for slave_host in $SLAVE_HOSTS; do
        check_gtid_status $slave_host "slave-$(echo $slave_host | tr '.' '-')"
    done
    
    # ä¸»ä»ä¸€è‡´æ€§æ£€æŸ¥
    check_master_slave_consistency
    
    # æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ï¼ˆå¯é€‰ï¼Œè€—æ—¶è¾ƒé•¿ï¼‰
    if [[ "$ENABLE_DATA_INTEGRITY_CHECK" == "true" ]]; then
        check_data_integrity
    fi
    
    log_message "INFO" "======== MySQL GTID å¥åº·æ£€æŸ¥å®Œæˆ ========"
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
```

#### âš™ï¸ é…ç½®æ–‡ä»¶ç¤ºä¾‹


```bash
# /etc/mysql-monitor/config.conf
# MySQL GTIDç›‘æ§é…ç½®æ–‡ä»¶

# æ•°æ®åº“è¿æ¥é…ç½®
MYSQL_USER="monitor"
MYSQL_PASS="monitor123"

# æœåŠ¡å™¨åˆ—è¡¨
MASTER_HOST="192.168.1.10"
SLAVE_HOSTS="192.168.1.11 192.168.1.12"

# æ£€æŸ¥é€‰é¡¹
ENABLE_DATA_INTEGRITY_CHECK="true"
CHECK_INTERVAL=300  # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰

# å‘Šè­¦é˜ˆå€¼
REPLICATION_LAG_WARNING=100
REPLICATION_LAG_CRITICAL=1000

# æ—¥å¿—é…ç½®
LOG_LEVEL="INFO"
LOG_RETENTION_DAYS=30
```

### 6.2 ç›‘æ§Dashboardè®¾è®¡


#### ğŸ“Š Dashboardæ ¸å¿ƒæŒ‡æ ‡


**GTIDç›‘æ§Dashboard**åº”è¯¥å±•ç¤ºçš„å…³é”®ä¿¡æ¯ï¼š

```
ä»ªè¡¨æ¿å¸ƒå±€è®¾è®¡ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MySQL GTID ç›‘æ§ä¸­å¿ƒ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœåŠ¡å™¨çŠ¶æ€     â”‚    GTIDæ¦‚è§ˆ     â”‚     å‘Šè­¦ä¿¡æ¯        â”‚
â”‚                â”‚                â”‚                     â”‚
â”‚ ğŸŸ¢ Master       â”‚ æ€»äº‹åŠ¡: 1,234,567â”‚ ğŸ”´ Slave2å»¶è¿Ÿä¸¥é‡   â”‚
â”‚ ğŸŸ¢ Slave1       â”‚ å¢é•¿ç‡: 45/sec  â”‚ ğŸŸ¡ Slave1è½»å¾®å»¶è¿Ÿ   â”‚
â”‚ ğŸ”´ Slave2       â”‚ å»¶è¿Ÿ: 234 TXN   â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GTIDè¶‹åŠ¿å›¾è¡¨                          â”‚
â”‚  äº‹åŠ¡æ•°é‡                                               â”‚
â”‚    â”‚                                                   â”‚
â”‚1000â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚    â”‚                                   â•±â”‚              â”‚
â”‚ 500â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•±â•±â•±â•±â•±â•± â”‚              â”‚
â”‚    â”‚                     â•±â•±â•±â•±â•±â•±â•±        â”‚              â”‚
â”‚   0â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”‚              â”‚
â”‚        08:00 10:00 12:00 14:00 16:00 18:00             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¤åˆ¶å»¶è¿Ÿç›‘æ§                           â”‚
â”‚ å»¶è¿Ÿ(äº‹åŠ¡æ•°)                                            â”‚
â”‚    â”‚                                                   â”‚ 
â”‚ 500â”œâ”€ Slave1 â–‚â–…â–…â–‚â–‚â–…â–…â–‚â–‚                               â”‚
â”‚    â”‚                                                   â”‚
â”‚ 250â”œâ”€ Slave2 â–ƒâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡ â† å»¶è¿Ÿå‘Šè­¦                     â”‚
â”‚    â”‚                                                   â”‚
â”‚   0â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€              â”‚
â”‚        08:00 10:00 12:00 14:00 16:00 18:00             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ“ˆ å®æ—¶ç›‘æ§æ¥å£


```python
#!/usr/bin/env python3
# GTIDç›‘æ§Dashboardåç«¯API

from flask import Flask, jsonify, render_template
import mysql.connector
import json
from datetime import datetime, timedelta

app = Flask(__name__)

class GTIDDashboardAPI:
    def __init__(self, db_configs):
        self.db_configs = db_configs
    
    def get_server_status(self):
        """è·å–æ‰€æœ‰æœåŠ¡å™¨çŠ¶æ€"""
        servers_status = []
        
        for server_name, config in self.db_configs.items():
            try:
                conn = mysql.connector.connect(**config, connection_timeout=5)
                cursor = conn.cursor()
                
                # è·å–åŸºæœ¬ä¿¡æ¯
                cursor.execute("""
                    SELECT 
                        $$global.gtid_executed,
                        $$global.gtid_purged,
                        $$global.server_uuid
                """)
                result = cursor.fetchone()
                
                # è·å–å¤åˆ¶çŠ¶æ€ï¼ˆä»åº“ï¼‰
                replication_status = None
                if server_name != 'master':
                    try:
                        cursor.execute("SHOW SLAVE STATUS")
                        slave_status = cursor.fetchone()
                        if slave_status:
                            replication_status = {
                                'io_running': slave_status[10] == 'Yes',
                                'sql_running': slave_status[11] == 'Yes', 
                                'seconds_behind': slave_status[32]
                            }
                    except:
                        pass
                
                conn.close()
                
                servers_status.append({
                    'name': server_name,
                    'status': 'online',
                    'gtid_executed': result[0],
                    'gtid_purged': result[1],
                    'server_uuid': result[2],
                    'replication': replication_status,
                    'last_check': datetime.now().isoformat()
                })
                
            except Exception as e:
                servers_status.append({
                    'name': server_name,
                    'status': 'offline',
                    'error': str(e),
                    'last_check': datetime.now().isoformat()
                })
        
        return servers_status
    
    def get_gtid_metrics(self, hours=24):
        """è·å–GTIDå†å²æŒ‡æ ‡"""
        # è¿™é‡Œåº”è¯¥ä»ç›‘æ§æ•°æ®åº“æˆ–æ—¶åºæ•°æ®åº“ä¸­è·å–å†å²æ•°æ®
        # ä¸ºæ¼”ç¤ºç›®çš„ï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®
        
        end_time = datetime.now()
        start_time = end_time - timedelta(hours=hours)
        
        # æ¨¡æ‹ŸæŒ‡æ ‡æ•°æ®
        metrics = {
            'master': {
                'gtid_count': [],
                'growth_rate': [],
                'timestamps': []
            }
        }
        
        # ç”Ÿæˆæ—¶é—´åºåˆ—
        current = start_time
        while current <= end_time:
            metrics['master']['timestamps'].append(current.isoformat())
            # æ¨¡æ‹Ÿé€’å¢çš„GTIDæ•°é‡
            base_count = 1000000
            hour_diff = (current - start_time).total_seconds() / 3600
            gtid_count = base_count + int(hour_diff * 3600 * 10)  # æ¯å°æ—¶3600*10ä¸ªäº‹åŠ¡
            metrics['master']['gtid_count'].append(gtid_count)
            
            # æ¨¡æ‹Ÿå¢é•¿ç‡
            growth_rate = 10 + (hour_diff % 12) * 2  # æ¨¡æ‹Ÿç™½å¤©å¤œæ™šçš„å·®å¼‚
            metrics['master']['growth_rate'].append(growth_rate)
            
            current += timedelta(minutes=30)
        
        return metrics

# åˆ›å»ºAPIå®ä¾‹
db_configs = {
    'master': {
        'host': '192.168.1.10',
        'user': 'monitor',
        'password': 'password',
        'database': 'mysql'
    },
    'slave1': {
        'host': '192.168.1.11',
        'user': 'monitor',
        'password': 'password', 
        'database': 'mysql'
    }
}

dashboard_api = GTIDDashboardAPI(db_configs)

# APIè·¯ç”±
@app.route('/api/servers/status')
def get_servers_status():
    """è·å–æœåŠ¡å™¨çŠ¶æ€API"""
    status = dashboard_api.get_server_status()
    return jsonify(status)

@app.route('/api/metrics/gtid')
def get_gtid_metrics():
    """è·å–GTIDæŒ‡æ ‡API"""
    metrics = dashboard_api.get_gtid_metrics()
    return jsonify(metrics)

@app.route('/api/alerts')
def get_alerts():
    """è·å–å‘Šè­¦ä¿¡æ¯API"""
    # ä»å‘Šè­¦ç³»ç»Ÿè·å–æœ€æ–°å‘Šè­¦
    alerts = [
        {
            'level': 'warning',
            'message': 'Slave1 å¤åˆ¶å»¶è¿Ÿè¾ƒå¤§',
            'timestamp': datetime.now().isoformat(),
            'server': 'slave1'
        }
    ]
    return jsonify(alerts)

@app.route('/')
def dashboard():
    """Dashboardé¦–é¡µ"""
    return render_template('dashboard.html')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080, debug=True)
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ GTIDç›‘æ§æœ¬è´¨ï¼šå®æ—¶æ£€æŸ¥MySQLå¤åˆ¶ç³»ç»Ÿçš„å¥åº·çŠ¶æ€
ğŸ”¸ å…³é”®ç›‘æ§å¯¹è±¡ï¼šgtid_executedã€gtid_purgedã€ä¸»ä»ä¸€è‡´æ€§
ğŸ”¸ ç›‘æ§æ ¸å¿ƒä»·å€¼ï¼šæå‰å‘ç°é—®é¢˜ã€å¿«é€Ÿå®šä½æ•…éšœã€ä¿éšœæ•°æ®å®‰å…¨
ğŸ”¸ æ£€æŸ¥æ–¹æ³•ï¼šçŠ¶æ€ç›‘æ§ã€ä¸€è‡´æ€§éªŒè¯ã€å®Œæ•´æ€§æ ¡éªŒ
ğŸ”¸ å‘Šè­¦ç­–ç•¥ï¼šåˆ†çº§å“åº”ã€æ™ºèƒ½é¢„è­¦ã€è‡ªåŠ¨åŒ–å¤„ç†
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆGTIDç›‘æ§å¦‚æ­¤é‡è¦**ï¼š
```
æ•°æ®å®‰å…¨ä¿éšœï¼š
- åŠæ—¶å‘ç°æ•°æ®ä¸ä¸€è‡´
- é˜²æ­¢æ•°æ®ä¸¢å¤±å’ŒæŸå
- ç¡®ä¿ä¸šåŠ¡è¿ç»­æ€§

æ•…éšœå¿«é€Ÿå“åº”ï¼š
- ä»å‡ å°æ—¶ç¼©çŸ­åˆ°å‡ åˆ†é’Ÿ
- è‡ªåŠ¨åŒ–æ£€æµ‹æ›¿ä»£äººå·¥å·¡æ£€
- é—®é¢˜å½±å“èŒƒå›´æœ€å°åŒ–
```

**ğŸ”¹ ç›‘æ§çš„å±‚æ¬¡å’Œæ·±åº¦**ï¼š
```
åŸºç¡€ç›‘æ§ï¼š
- GTIDé›†åˆçŠ¶æ€
- å¤åˆ¶å»¶è¿Ÿæ•°é‡
- æœåŠ¡å¯ç”¨æ€§

æ·±åº¦ç›‘æ§ï¼š
- æ•°æ®å†…å®¹ä¸€è‡´æ€§
- ä¸šåŠ¡é€»è¾‘å®Œæ•´æ€§  
- æ€§èƒ½æŒ‡æ ‡å¼‚å¸¸

æ™ºèƒ½ç›‘æ§ï¼š
- è¶‹åŠ¿åˆ†æé¢„è­¦
- å¼‚å¸¸æ¨¡å¼è¯†åˆ«
- è‡ªåŠ¨ä¿®å¤å»ºè®®
```

**ğŸ”¹ ç›‘æ§å·¥å…·çš„é€‰æ‹©åŸåˆ™**ï¼š
```
ç®€å•åœºæ™¯ï¼š
- åŸºç¡€SQLæŸ¥è¯¢ + Shellè„šæœ¬
- é€‚åˆå°è§„æ¨¡ã€è¦æ±‚ä¸é«˜çš„ç¯å¢ƒ

ä¸“ä¸šåœºæ™¯ï¼š
- pt-table-checksumç­‰ä¸“ä¸šå·¥å…·
- é€‚åˆå¤§è§„æ¨¡ã€é«˜è¦æ±‚çš„ç”Ÿäº§ç¯å¢ƒ

ä¼ä¸šåœºæ™¯ï¼š
- å®Œæ•´ç›‘æ§å¹³å° + Dashboard
- é€‚åˆå¤æ‚æ¶æ„ã€å¤šå›¢é˜Ÿåä½œ
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- **ç”µå•†ç³»ç»Ÿ**ï¼šè®¢å•æ•°æ®ä¸€è‡´æ€§ç›‘æ§ï¼Œé˜²æ­¢äº¤æ˜“æ•°æ®ä¸¢å¤±
- **é‡‘èç³»ç»Ÿ**ï¼šè´¦æˆ·ä½™é¢å®æ—¶ç›‘æ§ï¼Œç¡®ä¿èµ„é‡‘å®‰å…¨
- **æ—¥å¿—ç³»ç»Ÿ**ï¼šå®¡è®¡æ•°æ®å®Œæ•´æ€§ï¼Œæ»¡è¶³åˆè§„è¦æ±‚
- **å†…å®¹å¹³å°**ï¼šç”¨æˆ·æ•°æ®åŒæ­¥ç›‘æ§ï¼Œä¿éšœç”¨æˆ·ä½“éªŒ

**ğŸ”§ è¿ç»´å®è·µä»·å€¼**ï¼š
- **æ•…éšœé¢„é˜²**ï¼šæå‰å‘ç°æ½œåœ¨é—®é¢˜ï¼Œé¿å…æ•…éšœæ‰©å¤§
- **å¿«é€Ÿå“åº”**ï¼šè‡ªåŠ¨åŒ–å‘Šè­¦ï¼Œç¼©çŸ­æ•…éšœå¤„ç†æ—¶é—´
- **å®¹é‡è§„åˆ’**ï¼šåŸºäºç›‘æ§æ•°æ®è¿›è¡Œç³»ç»Ÿæ‰©å®¹å†³ç­–
- **åˆè§„å®¡è®¡**ï¼šå®Œæ•´çš„ç›‘æ§æ—¥å¿—ï¼Œæ»¡è¶³å®¡è®¡è¦æ±‚

### 7.4 æœ€ä½³å®è·µå»ºè®®


```
ç›‘æ§éƒ¨ç½²åŸåˆ™ï¼š
âœ… åˆ†å±‚ç›‘æ§ï¼šåŸºç¡€ç›‘æ§ + æ·±åº¦æ£€æŸ¥ + ä¸šåŠ¡éªŒè¯
âœ… åˆç†é¢‘ç‡ï¼šå…³é”®æŒ‡æ ‡å®æ—¶ç›‘æ§ï¼Œå®Œæ•´æ£€æŸ¥å®šæœŸæ‰§è¡Œ
âœ… å‘Šè­¦åˆ†çº§ï¼šæ ¹æ®å½±å“ç¨‹åº¦è®¾ç½®ä¸åŒå“åº”çº§åˆ«
âœ… è‡ªåŠ¨åŒ–ä¼˜å…ˆï¼šå‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜å“åº”é€Ÿåº¦

æ€§èƒ½ä¼˜åŒ–ï¼š
âœ… ç›‘æ§è½»é‡åŒ–ï¼šé¿å…ç›‘æ§æœ¬èº«å½±å“æ•°æ®åº“æ€§èƒ½
âœ… æ™ºèƒ½é‡‡æ ·ï¼šå¤§è¡¨æ£€æŸ¥ä½¿ç”¨é‡‡æ ·è€Œéå…¨è¡¨æ‰«æ
âœ… å¹¶è¡Œå¤„ç†ï¼šå¤šæœåŠ¡å™¨æ£€æŸ¥å¹¶è¡Œæ‰§è¡Œ
âœ… ç¼“å­˜æœºåˆ¶ï¼šé¢‘ç¹æŸ¥è¯¢ç»“æœé€‚å½“ç¼“å­˜

æ‰©å±•è§„åˆ’ï¼š
âœ… æ¨¡å—åŒ–è®¾è®¡ï¼šç›‘æ§ç»„ä»¶å¯ç‹¬ç«‹å‡çº§å’Œæ›¿æ¢
âœ… æ¥å£æ ‡å‡†åŒ–ï¼šä¾¿äºé›†æˆå…¶ä»–ç›‘æ§ç³»ç»Ÿ
âœ… æ•°æ®ä¿ç•™ï¼šç›‘æ§å†å²æ•°æ®ç”¨äºè¶‹åŠ¿åˆ†æ
âœ… æ–‡æ¡£å®Œæ•´ï¼šä¾¿äºå›¢é˜Ÿç»´æŠ¤å’ŒçŸ¥è¯†ä¼ æ‰¿
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- GTIDç›‘æ§ä¿æ•°æ®å®‰å…¨ï¼Œå®æ—¶æ£€æŸ¥é˜²æ‚£æœªç„¶
- çŠ¶æ€æŒ‡æ ‡çœ‹è¶‹åŠ¿ï¼Œä¸€è‡´æ€§æ£€æŸ¥æ‰¾é—®é¢˜  
- åˆ†çº§å‘Šè­¦å¿«å“åº”ï¼Œè‡ªåŠ¨åŒ–å·¥å…·ææ•ˆç‡
- ç›‘æ§ä¸æ˜¯ç›®çš„ï¼Œä¿éšœä¸šåŠ¡æ‰æ˜¯æ ¹æœ¬