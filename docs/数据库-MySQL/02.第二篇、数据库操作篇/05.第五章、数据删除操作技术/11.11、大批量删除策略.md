---
title: 11ã€å¤§æ‰¹é‡åˆ é™¤ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [å¤§æ‰¹é‡åˆ é™¤é¢ä¸´çš„æ ¸å¿ƒé—®é¢˜](#1-å¤§æ‰¹é‡åˆ é™¤é¢ä¸´çš„æ ¸å¿ƒé—®é¢˜)
2. [åˆ†æ‰¹åˆ é™¤æŠ€æœ¯åŸç†](#2-åˆ†æ‰¹åˆ é™¤æŠ€æœ¯åŸç†)
3. [DELETE LIMITåˆ†é¡µåˆ é™¤ç­–ç•¥](#3-DELETE-LIMITåˆ†é¡µåˆ é™¤ç­–ç•¥)
4. [åˆ é™¤æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯](#4-åˆ é™¤æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯)
5. [å¤§è¡¨åˆ é™¤ä¸“é¡¹æ–¹æ¡ˆ](#5-å¤§è¡¨åˆ é™¤ä¸“é¡¹æ–¹æ¡ˆ)
6. [åˆ é™¤æ“ä½œç›‘æ§ä¸æ¢å¤](#6-åˆ é™¤æ“ä½œç›‘æ§ä¸æ¢å¤)
7. [ç”Ÿäº§ç¯å¢ƒå®æˆ˜ç­–ç•¥](#7-ç”Ÿäº§ç¯å¢ƒå®æˆ˜ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’¥ å¤§æ‰¹é‡åˆ é™¤é¢ä¸´çš„æ ¸å¿ƒé—®é¢˜


### 1.1 ä¸ºä»€ä¹ˆå¤§æ‰¹é‡åˆ é™¤æ˜¯ä¸ªéš¾é¢˜


**ğŸ”¸ é—®é¢˜æ ¹æº**
æƒ³è±¡ä¸€ä¸‹è¦æ¸…ç†ä¸€ä¸ªæœ‰1000ä¸‡æ¡è®°å½•çš„ç”¨æˆ·è¡¨ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œï¼š
```sql
DELETE FROM users WHERE created_date < '2020-01-01';
```

è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„æ“ä½œä¼šå¸¦æ¥ç¾éš¾æ€§åæœï¼š

```
ç¾éš¾ç°åœºæ¨¡æ‹Ÿï¼š
â”Œâ”€ æ•°æ®åº“çŠ¶æ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ æ•´ä¸ªè¡¨è¢«é”å®š             â”‚
â”‚ ğŸ”´ å…¶ä»–ç”¨æˆ·æ— æ³•è®¿é—®          â”‚
â”‚ ğŸ”´ å†…å­˜è¢«äº‹åŠ¡æ—¥å¿—æ’‘çˆ†        â”‚
â”‚ ğŸ”´ IOå‹åŠ›ç¬é—´çˆ†è¡¨           â”‚
â”‚ ğŸ”´ ä»åº“å¤åˆ¶å»¶è¿Ÿä¸¥é‡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”ç†è§£**
```
å°±åƒæ¬å®¶æ—¶çš„ä¸¤ç§åšæ³•ï¼š

âŒ é”™è¯¯åšæ³•ï¼šä¸€æ¬¡æ¬å®Œæ‰€æœ‰ä¸œè¥¿
â€¢ ç´¯æ­»ç´¯æ´»ï¼Œä¸­é€”å¯èƒ½å‡ºé—®é¢˜
â€¢ æ¥¼é“è¢«å µï¼Œé‚»å±…éƒ½æ²¡æ³•é€šè¡Œ
â€¢ ä¸€æ—¦å‡ºé”™ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½è¦é‡æ¥

âœ… æ­£ç¡®åšæ³•ï¼šåˆ†æ‰¹æ¬¡æ¬è¿
â€¢ æ¯æ¬¡æ¬ä¸€éƒ¨åˆ†ï¼Œå¾ªåºæ¸è¿›
â€¢ ä¸å½±å“æ­£å¸¸é€šè¡Œ
â€¢ å‡ºé—®é¢˜åªå½±å“å½“å‰æ‰¹æ¬¡
```

### 1.2 å¤§æ‰¹é‡åˆ é™¤çš„æ ¸å¿ƒæŒ‘æˆ˜


**ğŸ”¥ æ€§èƒ½æŒ‘æˆ˜**
```
é”ç«äº‰é—®é¢˜ï¼š
â€¢ å¤§èŒƒå›´åˆ é™¤ä¼šè·å–è¡Œé”ã€è¡¨é”
â€¢ é˜»å¡å…¶ä»–è¯»å†™æ“ä½œ
â€¢ é€ æˆä¸šåŠ¡ç³»ç»Ÿè¶…æ—¶

å†…å­˜å‹åŠ›ï¼š
â€¢ äº‹åŠ¡æ—¥å¿—è†¨èƒ€ï¼ˆundo logï¼‰
â€¢ ç¼“å†²æ± è¢«å¤§é‡è„é¡µå ç”¨
â€¢ å¯èƒ½è§¦å‘OOMå¼‚å¸¸

IOç“¶é¢ˆï¼š
â€¢ ç£ç›˜å†™å…¥å‹åŠ›å·¨å¤§
â€¢ ç´¢å¼•æ›´æ–°å¼€é”€
â€¢ ä¸»ä»å¤åˆ¶å»¶è¿Ÿ
```

**âš ï¸ ä¸šåŠ¡é£é™©**
```
æœåŠ¡å¯ç”¨æ€§ï¼š
â€¢ æ¥å£å“åº”è¶…æ—¶
â€¢ ç”¨æˆ·ä½“éªŒä¸‹é™
â€¢ å¯èƒ½å¼•å‘é›ªå´©æ•ˆåº”

æ•°æ®å®‰å…¨ï¼š
â€¢ å¤§äº‹åŠ¡å›æ»šæˆæœ¬é«˜
â€¢ ä¸­é€”å¤±è´¥æ•°æ®ä¸ä¸€è‡´
â€¢ è¯¯åˆ æ•°æ®æ¢å¤å›°éš¾
```

**ğŸ“Š é—®é¢˜ä¸¥é‡ç¨‹åº¦è¯„ä¼°**
| åˆ é™¤è§„æ¨¡ | å½±å“ç¨‹åº¦ | å¤„ç†ç­–ç•¥ |
|---------|----------|----------|
| `< 1ä¸‡æ¡` | ğŸŸ¢ è½»å¾® | ç›´æ¥åˆ é™¤ |
| `1ä¸‡-10ä¸‡` | ğŸŸ¡ ä¸­ç­‰ | å°æ‰¹é‡åˆ†æ‰¹ |
| `10ä¸‡-100ä¸‡` | ğŸŸ  ä¸¥é‡ | ç²¾ç»†åˆ†æ‰¹+ç›‘æ§ |
| `> 100ä¸‡` | ğŸ”´ ç¾éš¾çº§ | ä¸“é¡¹æ–¹æ¡ˆè®¾è®¡ |

---

## 2. âœ‚ï¸ åˆ†æ‰¹åˆ é™¤æŠ€æœ¯åŸç†


### 2.1 åˆ†æ‰¹åˆ é™¤çš„æ ¸å¿ƒæ€æƒ³


**ğŸ¯ æ ¸å¿ƒç†å¿µ**
```
åŒ–æ•´ä¸ºé›¶åŸåˆ™ï¼š
å¤§æ‰¹é‡åˆ é™¤ = Nä¸ªå°æ‰¹é‡åˆ é™¤çš„ç»„åˆ

å•æ¬¡åˆ é™¤é‡æ§åˆ¶ï¼š
æ¯æ‰¹åˆ é™¤1000-5000æ¡ï¼ˆæ ¹æ®ä¸šåŠ¡è°ƒæ•´ï¼‰

é—´éš”ä¼‘æ¯æœºåˆ¶ï¼š
æ‰¹æ¬¡é—´çŸ­æš‚æš‚åœï¼Œé‡Šæ”¾é”å’Œèµ„æº
```

**ğŸ”„ åˆ†æ‰¹åˆ é™¤åŸºæœ¬æµç¨‹**
```
åˆ é™¤å¾ªç¯æµç¨‹ï¼š
â”Œâ”€ å¼€å§‹ â”€â”
â”‚        â”œâ”€ è®¡ç®—åˆ é™¤æ‰¹æ¬¡å¤§å°
â”‚        â”œâ”€ æ‰§è¡Œå•æ‰¹åˆ é™¤
â”‚        â”œâ”€ æ£€æŸ¥åˆ é™¤ç»“æœ
â”‚        â”œâ”€ çŸ­æš‚ä¼‘æ¯(å¯é€‰)
â”‚        â”œâ”€ æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ•°æ®
â”‚        â””â”€ å¾ªç¯æˆ–ç»“æŸ
```

### 2.2 åˆ†æ‰¹åˆ é™¤çš„ä¼˜åŠ¿åˆ†æ


**ğŸ“ˆ æ€§èƒ½ä¼˜åŠ¿**
```
é”æŒæœ‰æ—¶é—´ç¼©çŸ­ï¼š
â€¢ å•æ‰¹åˆ é™¤é”å®šæ—¶é—´ï¼šæ¯«ç§’çº§
â€¢ å¤§æ‰¹é‡åˆ é™¤é”å®šæ—¶é—´ï¼šåˆ†é’Ÿ/å°æ—¶çº§
â€¢ å…¶ä»–æ“ä½œæœ‰æœºä¼šç©¿æ’æ‰§è¡Œ

äº‹åŠ¡å¤§å°å¯æ§ï¼š
â€¢ æ¯ä¸ªäº‹åŠ¡å¤„ç†å°‘é‡æ•°æ®
â€¢ äº‹åŠ¡æ—¥å¿—å¤§å°ç¨³å®š
â€¢ å›æ»šä»£ä»·å¯æ§

èµ„æºä½¿ç”¨å¹³æ»‘ï¼š
â€¢ CPUã€å†…å­˜ã€IOè´Ÿè½½å¹³ç¼“
â€¢ é¿å…èµ„æºçªç„¶è€—å°½
â€¢ ç³»ç»Ÿç¨³å®šæ€§æå‡
```

**ğŸ›¡ï¸ å®‰å…¨ä¼˜åŠ¿**
```
æ•…éšœå½±å“å±€éƒ¨åŒ–ï¼š
â€¢ å•æ‰¹å¤±è´¥ä¸å½±å“å·²å®Œæˆæ‰¹æ¬¡
â€¢ å¯ä»¥ä»å¤±è´¥ç‚¹ç»§ç»­
â€¢ é™ä½æ•°æ®ä¸¢å¤±é£é™©

å¯æ§æ€§å¢å¼ºï¼š
â€¢ å¯ä»¥éšæ—¶æš‚åœåˆ é™¤è¿‡ç¨‹
â€¢ å¯ä»¥è°ƒæ•´åˆ é™¤é€Ÿåº¦
â€¢ å¯ä»¥å®æ—¶ç›‘æ§è¿›åº¦
```

### 2.3 åˆ†æ‰¹åˆ é™¤çš„æŠ€æœ¯åŸç†


**ğŸ”§ å®ç°æœºåˆ¶**
```sql
-- åŸºç¡€åˆ†æ‰¹åˆ é™¤æ¨¡æ¿
WHILE $$rowcount > 0
BEGIN
    DELETE TOP(1000) FROM large_table 
    WHERE condition_column < 'cutoff_value'
    
    -- çŸ­æš‚ä¼‘æ¯ï¼Œé‡Šæ”¾èµ„æº
    WAITFOR DELAY '00:00:01'
END
```

**ğŸ’­ åŸç†è§£æ**
```
ä¸ºä»€ä¹ˆåˆ†æ‰¹æœ‰æ•ˆï¼Ÿ

æ•°æ®åº“é”æœºåˆ¶ï¼š
â€¢ åˆ é™¤æ“ä½œéœ€è¦è·å–è¡Œé”
â€¢ é”æŒæœ‰æ—¶é—´ä¸åˆ é™¤é‡æˆæ­£æ¯”
â€¢ åˆ†æ‰¹å¯ä»¥å¿«é€Ÿé‡Šæ”¾é”

ç¼“å­˜ç®¡ç†ï¼š
â€¢ å¤§åˆ é™¤ä¼šæ±¡æŸ“ç¼“å†²æ± 
â€¢ å°æ‰¹é‡åˆ é™¤ç¼“å­˜å‹å¥½
â€¢ å‡å°‘ç¼“å­˜æ¢é¡µæ¬¡æ•°

æ—¥å¿—å†™å…¥ï¼š
â€¢ äº‹åŠ¡æ—¥å¿—å†™å…¥é‡å¯æ§
â€¢ é¿å…æ—¥å¿—æ–‡ä»¶å¿«é€Ÿå¢é•¿
â€¢ é™ä½ç£ç›˜IOå‹åŠ›
```

---

## 3. ğŸ”„ DELETE LIMITåˆ†é¡µåˆ é™¤ç­–ç•¥


### 3.1 DELETE LIMITæ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ åŸºæœ¬è¯­æ³•ç†è§£**
```sql
-- DELETE LIMITè¯­æ³•ï¼ˆMySQLï¼‰
DELETE FROM table_name 
WHERE condition 
LIMIT batch_size;
```

**ğŸ“– æ¦‚å¿µè§£é‡Š**
```
LIMITåœ¨DELETEä¸­çš„ä½œç”¨ï¼š
â€¢ é™åˆ¶å•æ¬¡åˆ é™¤çš„è¡Œæ•°
â€¢ é˜²æ­¢ä¸€æ¬¡æ€§åˆ é™¤è¿‡å¤šæ•°æ®
â€¢ æ˜¯åˆ†æ‰¹åˆ é™¤çš„æ ¸å¿ƒå·¥å…·

ä¸ºä»€ä¹ˆå«"åˆ†é¡µåˆ é™¤"ï¼Ÿ
â€¢ ç±»ä¼¼æŸ¥è¯¢æ—¶çš„LIMITåˆ†é¡µ
â€¢ æ¯æ¬¡åˆ é™¤å›ºå®šæ•°é‡çš„è¡Œ
â€¢ å¾ªç¯æ‰§è¡Œç›´åˆ°åˆ é™¤å®Œæˆ
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒåƒè‡ªåŠ©é¤ï¼š
âŒ ä¸€æ¬¡ç››æ»¡æ•´ä¸ªç›˜å­ â†’ å¯èƒ½åƒä¸å®Œæµªè´¹
âœ… æ¯æ¬¡ç››ä¸€ç‚¹ç‚¹ â†’ æ…¢æ…¢äº«ç”¨ï¼ŒæŒ‰éœ€å–ç”¨

DELETE LIMITå°±æ˜¯"æ¯æ¬¡åˆ ä¸€ç‚¹ç‚¹"çš„ç­–ç•¥
```

### 3.2 DELETE LIMITå®æˆ˜åº”ç”¨


**ğŸ”§ åŸºç¡€å®ç°æ¨¡å¼**
```sql
-- MySQLåˆ†æ‰¹åˆ é™¤ç¤ºä¾‹
DELIMITER $$
CREATE PROCEDURE batch_delete_old_logs()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE batch_count INT DEFAULT 0;
    
    -- å¾ªç¯åˆ é™¤
    WHILE done = 0 DO
        -- æ¯æ‰¹åˆ é™¤1000æ¡
        DELETE FROM access_logs 
        WHERE log_date < DATE_SUB(NOW(), INTERVAL 90 DAY)
        LIMIT 1000;
        
        -- æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ•°æ®
        IF ROW_COUNT() = 0 THEN
            SET done = 1;
        END IF;
        
        SET batch_count = batch_count + 1;
        
        -- æ¯10æ‰¹æš‚åœ1ç§’ï¼Œè®©ç³»ç»Ÿå–˜å£æ°”
        IF batch_count % 10 = 0 THEN
            DO SLEEP(1);
        END IF;
        
    END WHILE;
    
    SELECT CONCAT('åˆ é™¤å®Œæˆï¼Œå…±å¤„ç†', batch_count, 'æ‰¹æ¬¡') AS result;
END$$
DELIMITER ;
```

**ğŸ Pythonè„šæœ¬å®ç°**
```python
import time
import pymysql

def batch_delete_records(connection, table, condition, batch_size=1000):
    """
    åˆ†æ‰¹åˆ é™¤è®°å½•çš„é€šç”¨å‡½æ•°
    """
    total_deleted = 0
    batch_num = 0
    
    try:
        cursor = connection.cursor()
        
        while True:
            # æ‰§è¡Œåˆ†æ‰¹åˆ é™¤
            delete_sql = f"""
                DELETE FROM {table} 
                WHERE {condition} 
                LIMIT {batch_size}
            """
            
            cursor.execute(delete_sql)
            deleted_count = cursor.rowcount
            
            # æäº¤äº‹åŠ¡
            connection.commit()
            
            total_deleted += deleted_count
            batch_num += 1
            
            print(f"ç¬¬{batch_num}æ‰¹ï¼šåˆ é™¤äº†{deleted_count}æ¡è®°å½•")
            
            # å¦‚æœæ²¡æœ‰åˆ é™¤ä»»ä½•è®°å½•ï¼Œè¯´æ˜å®Œæˆäº†
            if deleted_count == 0:
                break
                
            # çŸ­æš‚ä¼‘æ¯ï¼Œé¿å…æŒç»­å ç”¨èµ„æº
            time.sleep(0.1)
            
    except Exception as e:
        print(f"åˆ é™¤è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼š{e}")
        connection.rollback()
    
    print(f"åˆ é™¤å®Œæˆï¼æ€»å…±åˆ é™¤{total_deleted}æ¡è®°å½•ï¼Œåˆ†{batch_num}æ‰¹æ‰§è¡Œ")

# ä½¿ç”¨ç¤ºä¾‹
connection = pymysql.connect(host='localhost', user='root', password='xxx', database='mydb')
batch_delete_records(connection, 'user_logs', "created_time < '2023-01-01'", 2000)
```

### 3.3 åˆ é™¤æ‰¹æ¬¡å¤§å°è°ƒä¼˜


**ğŸ›ï¸ æ‰¹æ¬¡å¤§å°é€‰æ‹©ç­–ç•¥**

| ä¸šåŠ¡åœºæ™¯ | **æ¨èæ‰¹æ¬¡å¤§å°** | **è°ƒä¼˜è€ƒè™‘** |
|---------|-----------------|-------------|
| `é«˜å¹¶å‘OLTP` | **500-1000æ¡** | `å‡å°‘é”ç«äº‰ï¼Œå¿«é€Ÿé‡Šæ”¾` |
| `æ•°æ®ä»“åº“` | **5000-10000æ¡** | `å¯å®¹å¿è¾ƒé•¿äº‹åŠ¡æ—¶é—´` |
| `å½’æ¡£æ¸…ç†` | **2000-5000æ¡** | `å¹³è¡¡æ•ˆç‡å’Œç¨³å®šæ€§` |
| `ç´§æ€¥æ¸…ç†` | **100-500æ¡** | `æœ€å°åŒ–ä¸šåŠ¡å½±å“` |

**âš¡ åŠ¨æ€æ‰¹æ¬¡å¤§å°ä¼˜åŒ–**
```python
class AdaptiveBatchDelete:
    def __init__(self, initial_batch_size=1000):
        self.batch_size = initial_batch_size
        self.performance_history = []
    
    def execute_batch_delete(self, cursor, delete_sql):
        start_time = time.time()
        
        # æ‰§è¡Œåˆ é™¤
        cursor.execute(delete_sql.replace('LIMIT ?', f'LIMIT {self.batch_size}'))
        deleted_count = cursor.rowcount
        
        # è®°å½•æ€§èƒ½æ•°æ®
        execution_time = time.time() - start_time
        self.performance_history.append({
            'batch_size': self.batch_size,
            'execution_time': execution_time,
            'deleted_count': deleted_count
        })
        
        # åŠ¨æ€è°ƒæ•´æ‰¹æ¬¡å¤§å°
        self.adjust_batch_size(execution_time)
        
        return deleted_count
    
    def adjust_batch_size(self, execution_time):
        """æ ¹æ®æ‰§è¡Œæ—¶é—´åŠ¨æ€è°ƒæ•´æ‰¹æ¬¡å¤§å°"""
        if execution_time < 0.1:  # å¤ªå¿«äº†ï¼Œå¯ä»¥å¢å¤§æ‰¹æ¬¡
            self.batch_size = min(self.batch_size * 1.2, 10000)
        elif execution_time > 2.0:  # å¤ªæ…¢äº†ï¼Œå‡å°æ‰¹æ¬¡
            self.batch_size = max(self.batch_size * 0.8, 100)
        # 0.1-2ç§’ä¹‹é—´æ˜¯ç†æƒ³èŒƒå›´ï¼Œä¸è°ƒæ•´
```

**ğŸ“Š æ‰¹æ¬¡å¤§å°å½±å“åˆ†æ**
```
æ‰¹æ¬¡å¤§å°ä¸æ€§èƒ½å…³ç³»ï¼š

å°æ‰¹æ¬¡ï¼ˆ100-500ï¼‰ï¼š
âœ… é”ç«äº‰æœ€å°
âœ… å¯¹ä¸šåŠ¡å½±å“æœ€å°  
âŒ æ€»æ‰§è¡Œæ—¶é—´è¾ƒé•¿
âŒ ç½‘ç»œå¼€é”€ç›¸å¯¹è¾ƒå¤§

ä¸­æ‰¹æ¬¡ï¼ˆ1000-3000ï¼‰ï¼š
âœ… æ€§èƒ½ä¸ç¨³å®šæ€§å¹³è¡¡
âœ… é€‚åˆå¤§å¤šæ•°åœºæ™¯
âš ï¸ éœ€è¦ç›‘æ§é”ç­‰å¾…

å¤§æ‰¹æ¬¡ï¼ˆ5000+ï¼‰ï¼š
âœ… æ€»æ‰§è¡Œæ—¶é—´æœ€çŸ­
âŒ é”æŒæœ‰æ—¶é—´é•¿
âŒ å¯¹ä¸šåŠ¡å½±å“è¾ƒå¤§
```

### 3.4 åˆ†é¡µåˆ é™¤çš„é«˜çº§æŠ€å·§


**ğŸ¯ åŸºäºä¸»é”®çš„ç²¾ç¡®åˆ†é¡µ**
```sql
-- é¿å…OFFSETæ•ˆç‡é—®é¢˜çš„åˆ†é¡µåˆ é™¤
SET @last_id = 0;

-- å¾ªç¯æ‰§è¡Œ
DELETE FROM large_table 
WHERE id > @last_id 
  AND created_time < '2023-01-01'
ORDER BY id 
LIMIT 1000;

-- è·å–æœ€ååˆ é™¤çš„IDï¼Œç”¨äºä¸‹æ¬¡å¾ªç¯
SELECT @last_id := MAX(id) FROM (
    SELECT id FROM large_table 
    WHERE id > @last_id 
      AND created_time < '2023-01-01'
    ORDER BY id 
    LIMIT 1000
) tmp;
```

**ğŸ’­ ä¸ºä»€ä¹ˆç”¨ä¸»é”®åˆ†é¡µæ›´å¥½**
```
ä¼ ç»ŸOFFSETåˆ†é¡µé—®é¢˜ï¼š
DELETE FROM table WHERE condition LIMIT 1000 OFFSET 10000;
â€¢ æ¯æ¬¡éƒ½è¦è·³è¿‡å‰é¢10000æ¡è®°å½•
â€¢ éšç€OFFSETå¢å¤§ï¼Œæ€§èƒ½æ€¥å‰§ä¸‹é™

ä¸»é”®åˆ†é¡µä¼˜åŠ¿ï¼š
DELETE FROM table WHERE id > last_id AND condition LIMIT 1000;  
â€¢ åˆ©ç”¨ä¸»é”®ç´¢å¼•å¿«é€Ÿå®šä½
â€¢ æ€§èƒ½ä¿æŒç¨³å®š
â€¢ å¤©ç„¶æ”¯æŒæ–­ç‚¹ç»­ä¼ 
```

---

## 4. âš¡ åˆ é™¤æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯


### 4.1 é”ç­‰å¾…æ§åˆ¶ç­–ç•¥


**ğŸ”’ ç†è§£æ•°æ®åº“é”æœºåˆ¶**
```
åˆ é™¤æ“ä½œçš„é”è¡Œä¸ºï¼š
â”Œâ”€ åˆ é™¤è¿‡ç¨‹ä¸­çš„é” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â”‚
â”‚ 1. å…ˆè·å–è¦åˆ é™¤è¡Œçš„è¡Œé”   â”‚
â”‚ 2. æ›´æ–°ç›¸å…³ç´¢å¼•æ—¶è·å–é”   â”‚  
â”‚ 3. äº‹åŠ¡æäº¤å‰ä¸€ç›´æŒæœ‰     â”‚
â”‚ 4. æäº¤åé‡Šæ”¾æ‰€æœ‰é”       â”‚
â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é”ç­‰å¾…çš„è¿é”ååº”ï¼š
ç”¨æˆ·Aåˆ é™¤ â†’ æŒæœ‰è¡Œé” â†’ ç”¨æˆ·BæŸ¥è¯¢ç­‰å¾… â†’ ç”¨æˆ·Cæ›´æ–°æ’é˜Ÿ â†’ ç³»ç»Ÿå¡é¡¿
```

**ğŸ›ï¸ é”ç­‰å¾…æ—¶é—´æ§åˆ¶**
```sql
-- MySQLé”ç­‰å¾…æ§åˆ¶
SET SESSION innodb_lock_wait_timeout = 5;  -- 5ç§’è¶…æ—¶

-- åˆ é™¤æ—¶æ£€æŸ¥é”ç­‰å¾…
SELECT 
    r.trx_id waiting_trx_id,
    r.trx_mysql_thread_id waiting_thread,
    r.trx_query waiting_query,
    b.trx_id blocking_trx_id,
    b.trx_mysql_thread_id blocking_thread
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id  
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;
```

**â±ï¸ åˆ é™¤æ“ä½œæš‚åœæœºåˆ¶**
```python
import time
import threading

class DeleteController:
    def __init__(self):
        self.should_pause = False
        self.should_stop = False
        
    def batch_delete_with_control(self, cursor, delete_sql, batch_size):
        total_deleted = 0
        
        while True:
            # æ£€æŸ¥æš‚åœæ ‡å¿—
            if self.should_pause:
                print("åˆ é™¤æ“ä½œå·²æš‚åœï¼Œç­‰å¾…æ¢å¤...")
                while self.should_pause and not self.should_stop:
                    time.sleep(1)
                    
            # æ£€æŸ¥åœæ­¢æ ‡å¿—  
            if self.should_stop:
                print("åˆ é™¤æ“ä½œå·²åœæ­¢")
                break
                
            # æ‰§è¡Œåˆ é™¤
            cursor.execute(delete_sql, (batch_size,))
            deleted_count = cursor.rowcount
            
            if deleted_count == 0:
                break
                
            total_deleted += deleted_count
            print(f"å·²åˆ é™¤ {total_deleted} æ¡è®°å½•")
            
            # æ‰¹æ¬¡é—´ä¼‘æ¯
            time.sleep(0.1)
            
        return total_deleted
    
    def pause(self):
        """æš‚åœåˆ é™¤"""
        self.should_pause = True
        
    def resume(self):
        """æ¢å¤åˆ é™¤"""
        self.should_pause = False
        
    def stop(self):
        """åœæ­¢åˆ é™¤"""
        self.should_stop = True
```

### 4.2 äº‹åŠ¡å¤§å°æ§åˆ¶æŠ€æœ¯


**ğŸ“¦ äº‹åŠ¡å¤§å°çš„å…³é”®å½±å“**
```
å°äº‹åŠ¡ä¼˜åŠ¿ï¼š
âœ… é”æŒæœ‰æ—¶é—´çŸ­
âœ… å›æ»šä»£ä»·å°
âœ… ä¸é˜»å¡å…¶ä»–æ“ä½œ
âœ… å†…å­˜ä½¿ç”¨ç¨³å®š

å¤§äº‹åŠ¡é—®é¢˜ï¼š
âŒ é•¿æ—¶é—´æŒæœ‰é”
âŒ å›æ»šä»£ä»·å·¨å¤§  
âŒ å†…å­˜å¯èƒ½æº¢å‡º
âŒ ä¸»ä»å»¶è¿Ÿå¢åŠ 
```

**ğŸ¯ æœ€ä½³äº‹åŠ¡å¤§å°ç­–ç•¥**
```sql
-- ç­–ç•¥1ï¼šå›ºå®šå¤§å°æ‰¹æ¬¡
BEGIN;
DELETE FROM logs WHERE created_time < '2023-01-01' LIMIT 1000;
COMMIT;

-- ç­–ç•¥2ï¼šåŸºäºæ—¶é—´çš„æ‰¹æ¬¡æ§åˆ¶
SET @start_time = NOW();
BEGIN;
WHILE TIMESTAMPDIFF(SECOND, @start_time, NOW()) < 30 DO
    DELETE FROM logs WHERE created_time < '2023-01-01' LIMIT 100;
    IF ROW_COUNT() = 0 THEN LEAVE; END IF;
END WHILE;
COMMIT;
```

**âš–ï¸ äº‹åŠ¡å¤§å°å†³ç­–æ¡†æ¶**
```
ä¸šåŠ¡é«˜å³°æœŸï¼š
â€¢ äº‹åŠ¡å¤§å°ï¼š100-500æ¡
â€¢ æ‰¹æ¬¡é—´éš”ï¼š100-500æ¯«ç§’
â€¢ ç›®æ ‡ï¼šæœ€å°åŒ–ä¸šåŠ¡å½±å“

ä¸šåŠ¡ä½è°·æœŸï¼š
â€¢ äº‹åŠ¡å¤§å°ï¼š2000-5000æ¡  
â€¢ æ‰¹æ¬¡é—´éš”ï¼š50-100æ¯«ç§’
â€¢ ç›®æ ‡ï¼šæé«˜åˆ é™¤æ•ˆç‡

ç´§æ€¥æƒ…å†µï¼š
â€¢ äº‹åŠ¡å¤§å°ï¼š50-200æ¡
â€¢ æ‰¹æ¬¡é—´éš”ï¼š1-2ç§’
â€¢ ç›®æ ‡ï¼šç¡®ä¿ç³»ç»Ÿç¨³å®š
```

### 4.3 ç´¢å¼•å¯¹åˆ é™¤æ€§èƒ½çš„å½±å“


**ğŸ“‡ ç´¢å¼•ä¸åˆ é™¤çš„å…³ç³»**
```
åˆ é™¤æ“ä½œçš„ç´¢å¼•æ›´æ–°è¿‡ç¨‹ï¼š
â”Œâ”€ åˆ é™¤ä¸€æ¡è®°å½•æ—¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â”‚
â”‚ 1. å®šä½è¦åˆ é™¤çš„è®°å½•       â”‚
â”‚ 2. åˆ é™¤ä¸»è¡¨ä¸­çš„è®°å½•       â”‚
â”‚ 3. æ›´æ–°æ‰€æœ‰ç›¸å…³ç´¢å¼•       â”‚
â”‚ 4. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯          â”‚
â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç´¢å¼•è¶Šå¤šï¼Œåˆ é™¤è¶Šæ…¢ï¼
```

**ğŸ—ï¸ å¤§è¡¨åˆ é™¤ç´¢å¼•ç­–ç•¥**
```sql
-- ç­–ç•¥1ï¼šä¸´æ—¶åˆ é™¤ç´¢å¼•ï¼ˆé€‚åˆåˆ é™¤å¤§é‡æ•°æ®ï¼‰
-- åˆ é™¤å‰è®°å½•ç´¢å¼•ç»“æ„
SHOW CREATE TABLE large_table;

-- åˆ é™¤éä¸»é”®ç´¢å¼•
DROP INDEX idx_created_time ON large_table;
DROP INDEX idx_user_id ON large_table;

-- æ‰§è¡Œå¤§æ‰¹é‡åˆ é™¤
DELETE FROM large_table WHERE created_time < '2023-01-01';

-- é‡å»ºç´¢å¼•
CREATE INDEX idx_created_time ON large_table(created_time);
CREATE INDEX idx_user_id ON large_table(user_id);
```

**âš ï¸ ç´¢å¼•ç­–ç•¥é€‰æ‹©**
```
ä½•æ—¶åˆ é™¤ç´¢å¼•ï¼Ÿ
âœ… åˆ é™¤æ•°æ®é‡ > è¡¨æ€»é‡çš„30%
âœ… æœ‰å¤šä¸ªéä¸»é”®ç´¢å¼•
âœ… å¯ä»¥æ¥å—çŸ­æ—¶é—´çš„æŸ¥è¯¢æ€§èƒ½ä¸‹é™

ä½•æ—¶ä¿ç•™ç´¢å¼•ï¼Ÿ
âœ… åˆ é™¤æ•°æ®é‡ < è¡¨æ€»é‡çš„10%  
âœ… åˆ é™¤æœŸé—´ä»æœ‰é«˜é¢‘æŸ¥è¯¢
âœ… ç´¢å¼•é‡å»ºæ—¶é—´è¿‡é•¿
```

---

## 5. ğŸ—„ï¸ å¤§è¡¨åˆ é™¤ä¸“é¡¹æ–¹æ¡ˆ


### 5.1 ä»€ä¹ˆç®—æ˜¯"å¤§è¡¨"


**ğŸ“ å¤§è¡¨åˆ¤æ–­æ ‡å‡†**
```
æ•°æ®é‡ç»´åº¦ï¼š
ğŸ”´ è¶…å¤§è¡¨ï¼š> 1äº¿æ¡è®°å½•
ğŸŸ  å¤§è¡¨ï¼š1000ä¸‡ - 1äº¿æ¡
ğŸŸ¡ ä¸­è¡¨ï¼š100ä¸‡ - 1000ä¸‡æ¡
ğŸŸ¢ å°è¡¨ï¼š< 100ä¸‡æ¡

å­˜å‚¨ç©ºé—´ç»´åº¦ï¼š
ğŸ”´ è¶…å¤§è¡¨ï¼š> 100GB
ğŸŸ  å¤§è¡¨ï¼š10GB - 100GB  
ğŸŸ¡ ä¸­è¡¨ï¼š1GB - 10GB
ğŸŸ¢ å°è¡¨ï¼š< 1GB

ä¸šåŠ¡å½±å“ç»´åº¦ï¼š
ğŸ”´ æ ¸å¿ƒè¡¨ï¼šå½±å“ä¸»ä¸šåŠ¡æµç¨‹
ğŸŸ  é‡è¦è¡¨ï¼šå½±å“è¾…åŠ©åŠŸèƒ½
ğŸŸ¡ ä¸€èˆ¬è¡¨ï¼šå½±å“è¾ƒå°
ğŸŸ¢ æ—¥å¿—è¡¨ï¼šå‡ ä¹æ— ä¸šåŠ¡å½±å“
```

### 5.2 å¤§è¡¨åˆ é™¤æ–¹æ¡ˆè®¾è®¡


**ğŸ—ï¸ æ–¹æ¡ˆä¸€ï¼šåˆ†åŒºè¡¨åˆ é™¤**
```sql
-- åˆ©ç”¨åˆ†åŒºå¿«é€Ÿåˆ é™¤
-- å‰æï¼šè¡¨å·²æŒ‰æ—¶é—´åˆ†åŒº

-- æŸ¥çœ‹åˆ†åŒºä¿¡æ¯
SELECT 
    partition_name,
    partition_description,
    table_rows
FROM information_schema.partitions 
WHERE table_name = 'large_table'
AND partition_name IS NOT NULL;

-- åˆ é™¤æ•´ä¸ªåˆ†åŒºï¼ˆç§’çº§å®Œæˆï¼‰
ALTER TABLE large_table DROP PARTITION p2023q1;

-- é‡å»ºåˆ†åŒºç»“æ„
ALTER TABLE large_table ADD PARTITION (
    PARTITION p2025q3 VALUES LESS THAN ('2025-10-01')
);
```

**ğŸ’¡ åˆ†åŒºåˆ é™¤çš„ä¼˜åŠ¿**
```
ä¸ºä»€ä¹ˆåˆ†åŒºåˆ é™¤è¿™ä¹ˆå¿«ï¼Ÿ

æ™®é€šåˆ é™¤è¿‡ç¨‹ï¼š
é€è¡Œæ‰«æ â†’ é€è¡Œåˆ é™¤ â†’ é€è¡Œæ›´æ–°ç´¢å¼• â†’ é€è¡Œå†™æ—¥å¿—

åˆ†åŒºåˆ é™¤è¿‡ç¨‹ï¼š  
ç›´æ¥åˆ é™¤åˆ†åŒºæ–‡ä»¶ â†’ æ›´æ–°å…ƒæ•°æ® â†’ å®Œæˆ

æ—¶é—´å¯¹æ¯”ï¼š
åˆ é™¤1000ä¸‡æ¡è®°å½•ï¼š
â€¢ æ™®é€šDELETEï¼š2-4å°æ—¶
â€¢ DROP PARTITIONï¼š10-30ç§’

åŸç†ï¼šè·³è¿‡äº†é€è¡Œå¤„ç†çš„å¼€é”€
```

**ğŸ—ï¸ æ–¹æ¡ˆäºŒï¼šè¡¨é‡å‘½ååˆ é™¤**
```sql
-- é€‚ç”¨äºåˆ é™¤å¤§éƒ¨åˆ†æ•°æ®çš„æƒ…å†µ

-- æ­¥éª¤1ï¼šåˆ›å»ºæ–°è¡¨ç»“æ„
CREATE TABLE users_new LIKE users;

-- æ­¥éª¤2ï¼šå¤åˆ¶éœ€è¦ä¿ç•™çš„æ•°æ®
INSERT INTO users_new 
SELECT * FROM users 
WHERE created_time >= '2023-01-01';

-- æ­¥éª¤3ï¼šåŸå­æ€§åˆ‡æ¢
RENAME TABLE users TO users_old, users_new TO users;

-- æ­¥éª¤4ï¼šåˆ é™¤æ—§è¡¨
DROP TABLE users_old;
```

**âš–ï¸ è¡¨é‡å‘½åæ–¹æ¡ˆè¯„ä¼°**
```
é€‚ç”¨æ¡ä»¶ï¼š
âœ… éœ€è¦åˆ é™¤çš„æ•°æ® > ä¿ç•™æ•°æ®
âœ… å¯ä»¥æ¥å—çŸ­æš‚çš„å†™å…¥æš‚åœ
âœ… æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´

ä¼˜åŠ¿ï¼š
â€¢ åˆ é™¤é€Ÿåº¦æå¿«
â€¢ ä¸äº§ç”Ÿé”ç«äº‰
â€¢ åŸå­æ€§æ“ä½œ

é£é™©ï¼š
â€¢ éœ€è¦é¢å¤–å­˜å‚¨ç©ºé—´
â€¢ åˆ‡æ¢æœŸé—´çŸ­æš‚ä¸å¯ç”¨
â€¢ éœ€è¦æ›´æ–°åº”ç”¨é…ç½®
```

### 5.3 å¤§è¡¨åˆ é™¤çš„å‡†å¤‡å·¥ä½œ


**ğŸ“‹ åˆ é™¤å‰æ£€æŸ¥æ¸…å•**
```
ğŸ” **å®¹é‡è¯„ä¼°**
â–¡ è¯„ä¼°è¦åˆ é™¤çš„æ•°æ®é‡
â–¡ æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³  
â–¡ ç¡®è®¤åˆ é™¤åç©ºé—´å›æ”¶æœºåˆ¶

ğŸ”’ **å®‰å…¨æ£€æŸ¥**
â–¡ å¤‡ä»½é‡è¦æ•°æ®
â–¡ ç¡®è®¤åˆ é™¤æ¡ä»¶å‡†ç¡®æ€§
â–¡ è®¾ç½®åˆ é™¤æ“ä½œçš„å›æ»šç‚¹

âš¡ **æ€§èƒ½é¢„ä¼°**  
â–¡ è¯„ä¼°åˆ é™¤è€—æ—¶
â–¡ é€‰æ‹©ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ
â–¡ å‡†å¤‡æ€§èƒ½ç›‘æ§è„šæœ¬

ğŸš¨ **é£é™©æ§åˆ¶**
â–¡ åˆ¶å®šåº”æ€¥å¤„ç†é¢„æ¡ˆ
â–¡ å‡†å¤‡å›æ»šç­–ç•¥
â–¡ é€šçŸ¥ç›¸å…³ä¸šåŠ¡æ–¹
```

**ğŸ”§ åˆ é™¤ç¯å¢ƒå‡†å¤‡**
```sql
-- åˆ é™¤å‰çš„ç³»ç»Ÿé…ç½®ä¼˜åŒ–

-- 1. è°ƒæ•´äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆMySQLï¼‰
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- 2. å…³é—­æŸ¥è¯¢ç¼“å­˜ï¼ˆé¿å…ç¼“å­˜æ±¡æŸ“ï¼‰
SET SESSION query_cache_type = OFF;

-- 3. è°ƒæ•´æ‰¹é‡æ’å…¥å‚æ•°
SET SESSION bulk_insert_buffer_size = 8388608; -- 8MB

-- 4. ç›‘æ§åˆ é™¤è¿›åº¦çš„è¾…åŠ©è¡¨
CREATE TABLE delete_progress (
    table_name VARCHAR(64),
    start_time DATETIME,
    last_batch_time DATETIME,
    total_deleted INT,
    batch_count INT,
    status ENUM('running', 'paused', 'completed', 'failed')
);
```

---

## 6. ğŸ“Š åˆ é™¤æ“ä½œç›‘æ§ä¸æ¢å¤


### 6.1 åˆ é™¤è¿›åº¦è·Ÿè¸ªæŠ€æœ¯


**ğŸ“ˆ è¿›åº¦ç›‘æ§çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§åˆ é™¤è¿›åº¦ï¼Ÿ

æ—¶é—´é¢„ä¼°ï¼š
â€¢ çŸ¥é“è¿˜éœ€è¦å¤šé•¿æ—¶é—´å®Œæˆ
â€¢ åˆç†å®‰æ’ä¸šåŠ¡ç»´æŠ¤çª—å£
â€¢ é¿å…è¶…æ—¶å¯¼è‡´çš„ä¸šåŠ¡å½±å“

é£é™©æ§åˆ¶ï¼š
â€¢ åŠæ—¶å‘ç°æ€§èƒ½å¼‚å¸¸
â€¢ ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨
â€¢ æå‰é¢„è­¦æ½œåœ¨é—®é¢˜

å†³ç­–æ”¯æŒï¼š
â€¢ æ˜¯å¦éœ€è¦è°ƒæ•´åˆ é™¤ç­–ç•¥
â€¢ æ˜¯å¦éœ€è¦å¢åŠ èµ„æº
â€¢ æ˜¯å¦éœ€è¦æš‚åœæ“ä½œ
```

**ğŸ”§ è¿›åº¦è·Ÿè¸ªå®ç°**
```python
import time
from datetime import datetime

class DeleteProgressTracker:
    def __init__(self, table_name, total_estimate=None):
        self.table_name = table_name
        self.start_time = datetime.now()
        self.total_deleted = 0
        self.batch_count = 0
        self.total_estimate = total_estimate
        
    def update_progress(self, batch_deleted):
        self.total_deleted += batch_deleted
        self.batch_count += 1
        
        # è®¡ç®—è¿›åº¦ä¿¡æ¯
        elapsed = (datetime.now() - self.start_time).total_seconds()
        avg_speed = self.total_deleted / elapsed if elapsed > 0 else 0
        
        progress_info = {
            'table': self.table_name,
            'total_deleted': self.total_deleted,
            'batch_count': self.batch_count,
            'elapsed_seconds': elapsed,
            'avg_speed_per_second': avg_speed,
            'timestamp': datetime.now()
        }
        
        # å¦‚æœæœ‰æ€»é‡ä¼°è®¡ï¼Œè®¡ç®—å®Œæˆç™¾åˆ†æ¯”
        if self.total_estimate:
            progress_pct = (self.total_deleted / self.total_estimate) * 100
            remaining = self.total_estimate - self.total_deleted
            eta_seconds = remaining / avg_speed if avg_speed > 0 else 0
            
            progress_info.update({
                'progress_percent': progress_pct,
                'estimated_remaining': remaining,
                'eta_seconds': eta_seconds
            })
            
        self.log_progress(progress_info)
        return progress_info
    
    def log_progress(self, info):
        """è®°å½•è¿›åº¦åˆ°æ—¥å¿—"""
        if 'progress_percent' in info:
            print(f"åˆ é™¤è¿›åº¦: {info['progress_percent']:.1f}% "
                  f"({info['total_deleted']}/{self.total_estimate}) "
                  f"é¢„è®¡å‰©ä½™: {info['eta_seconds']:.0f}ç§’")
        else:
            print(f"å·²åˆ é™¤: {info['total_deleted']} æ¡è®°å½• "
                  f"å¹³å‡é€Ÿåº¦: {info['avg_speed_per_second']:.0f} æ¡/ç§’")
```

### 6.2 åˆ é™¤æ“ä½œçš„ä¸­æ–­æ¢å¤


**ğŸ”„ æ–­ç‚¹ç»­ä¼ è®¾è®¡**
```sql
-- åˆ›å»ºåˆ é™¤çŠ¶æ€è®°å½•è¡¨
CREATE TABLE delete_checkpoint (
    id INT AUTO_INCREMENT PRIMARY KEY,
    table_name VARCHAR(64) NOT NULL,
    delete_condition TEXT NOT NULL,
    last_processed_id BIGINT DEFAULT 0,
    batch_size INT DEFAULT 1000,
    total_deleted INT DEFAULT 0,
    status ENUM('running', 'paused', 'completed', 'failed') DEFAULT 'running',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**ğŸš€ å¯æ¢å¤çš„åˆ é™¤ç¨‹åº**
```python
class RecoverableBatchDelete:
    def __init__(self, connection, table_name, condition):
        self.connection = connection
        self.table_name = table_name
        self.condition = condition
        self.checkpoint_id = None
        
    def start_or_resume_delete(self, batch_size=1000):
        """å¼€å§‹æ–°çš„åˆ é™¤æˆ–æ¢å¤ä¹‹å‰çš„åˆ é™¤"""
        cursor = self.connection.cursor()
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æœªå®Œæˆçš„åˆ é™¤ä»»åŠ¡
        cursor.execute("""
            SELECT id, last_processed_id, total_deleted 
            FROM delete_checkpoint 
            WHERE table_name = %s AND status = 'paused'
            ORDER BY created_time DESC LIMIT 1
        """, (self.table_name,))
        
        checkpoint = cursor.fetchone()
        
        if checkpoint:
            # æ¢å¤ä¹‹å‰çš„åˆ é™¤
            self.checkpoint_id = checkpoint[0]
            last_id = checkpoint[1]
            total_deleted = checkpoint[2]
            print(f"æ¢å¤åˆ é™¤ä»»åŠ¡ï¼Œä»ID {last_id} ç»§ç»­ï¼Œå·²åˆ é™¤ {total_deleted} æ¡")
        else:
            # å¼€å§‹æ–°çš„åˆ é™¤ä»»åŠ¡
            cursor.execute("""
                INSERT INTO delete_checkpoint (table_name, delete_condition, batch_size)
                VALUES (%s, %s, %s)
            """, (self.table_name, self.condition, batch_size))
            self.checkpoint_id = cursor.lastrowid
            last_id = 0
            total_deleted = 0
            print("å¼€å§‹æ–°çš„åˆ é™¤ä»»åŠ¡")
            
        self.connection.commit()
        return self.execute_batch_delete(last_id, total_deleted, batch_size)
    
    def execute_batch_delete(self, start_id, total_deleted, batch_size):
        cursor = self.connection.cursor()
        current_total = total_deleted
        last_processed_id = start_id
        
        try:
            while True:
                # æ„å»ºåˆ é™¤SQL
                delete_sql = f"""
                    DELETE FROM {self.table_name} 
                    WHERE id > %s AND {self.condition}
                    ORDER BY id LIMIT %s
                """
                
                cursor.execute(delete_sql, (last_processed_id, batch_size))
                deleted_count = cursor.rowcount
                
                if deleted_count == 0:
                    break
                    
                current_total += deleted_count
                
                # è·å–æœ¬æ‰¹æ¬¡åˆ é™¤çš„æœ€å¤§ID
                cursor.execute(f"""
                    SELECT MAX(id) FROM {self.table_name} 
                    WHERE id > %s AND {self.condition}
                    LIMIT %s
                """, (last_processed_id, batch_size))
                
                result = cursor.fetchone()
                if result[0]:
                    last_processed_id = result[0]
                
                # æ›´æ–°æ£€æŸ¥ç‚¹
                self.update_checkpoint(last_processed_id, current_total)
                self.connection.commit()
                
                print(f"æ‰¹æ¬¡å®Œæˆ: åˆ é™¤ {deleted_count} æ¡, ç´¯è®¡ {current_total} æ¡")
                time.sleep(0.1)  # çŸ­æš‚ä¼‘æ¯
                
        except Exception as e:
            print(f"åˆ é™¤è¿‡ç¨‹å‡ºé”™: {e}")
            self.mark_checkpoint_failed()
            raise
            
        # æ ‡è®°å®Œæˆ
        self.mark_checkpoint_completed()
        print(f"åˆ é™¤å®Œæˆï¼æ€»å…±åˆ é™¤ {current_total} æ¡è®°å½•")
        
    def update_checkpoint(self, last_id, total_deleted):
        """æ›´æ–°æ£€æŸ¥ç‚¹ä¿¡æ¯"""
        cursor = self.connection.cursor()
        cursor.execute("""
            UPDATE delete_checkpoint 
            SET last_processed_id = %s, total_deleted = %s, 
                updated_time = CURRENT_TIMESTAMP
            WHERE id = %s
        """, (last_id, total_deleted, self.checkpoint_id))
```

### 6.3 åˆ é™¤æ€§èƒ½ç›‘æ§


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```sql
-- å®æ—¶ç›‘æ§åˆ é™¤æ“ä½œçš„å½±å“

-- 1. é”ç­‰å¾…ç›‘æ§
SELECT 
    waiting_pid,
    waiting_query,
    blocking_pid,
    wait_age
FROM sys.innodb_lock_waits;

-- 2. äº‹åŠ¡çŠ¶æ€ç›‘æ§  
SELECT 
    trx_id,
    trx_state,
    trx_started,
    trx_requested_lock_id,
    trx_wait_started,
    trx_rows_locked,
    trx_rows_modified
FROM information_schema.innodb_trx;

-- 3. ç³»ç»Ÿè´Ÿè½½ç›‘æ§
SHOW GLOBAL STATUS LIKE 'Innodb_rows_deleted';
SHOW GLOBAL STATUS LIKE 'Slow_queries';
```

**ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡è·Ÿè¸ª**
```python
class DeletePerformanceMonitor:
    def __init__(self, connection):
        self.connection = connection
        self.metrics = []
        
    def collect_metrics(self):
        """æ”¶é›†åˆ é™¤æ€§èƒ½æŒ‡æ ‡"""
        cursor = self.connection.cursor()
        
        # CPUä½¿ç”¨ç‡
        cursor.execute("SHOW GLOBAL STATUS LIKE 'Threads_running'")
        threads_running = cursor.fetchone()[1]
        
        # é”ç­‰å¾…æƒ…å†µ
        cursor.execute("SELECT COUNT(*) FROM information_schema.innodb_lock_waits")
        lock_waits = cursor.fetchone()[0]
        
        # IOçŠ¶æ€
        cursor.execute("SHOW GLOBAL STATUS LIKE 'Innodb_data_pending_writes'")
        pending_writes = cursor.fetchone()[1]
        
        metrics = {
            'timestamp': datetime.now(),
            'threads_running': threads_running,
            'lock_waits': lock_waits, 
            'pending_writes': pending_writes
        }
        
        self.metrics.append(metrics)
        return metrics
    
    def check_performance_alerts(self, metrics):
        """æ£€æŸ¥æ€§èƒ½å‘Šè­¦"""
        alerts = []
        
        if metrics['threads_running'] > 50:
            alerts.append("âš ï¸ æ•°æ®åº“è¿æ¥æ•°è¿‡é«˜")
            
        if metrics['lock_waits'] > 10:
            alerts.append("ğŸ”’ é”ç­‰å¾…è¿‡å¤šï¼Œå»ºè®®æš‚åœåˆ é™¤")
            
        if metrics['pending_writes'] > 1000:
            alerts.append("ğŸ’¾ IOå‹åŠ›è¿‡å¤§")
            
        return alerts
```

---

## 7. ğŸ¯ ç”Ÿäº§ç¯å¢ƒå®æˆ˜ç­–ç•¥


### 7.1 ç”Ÿäº§åˆ é™¤çš„é£é™©æ§åˆ¶


**ğŸš¨ ç”Ÿäº§ç¯å¢ƒçš„ç‰¹æ®Šè€ƒè™‘**
```
ç”Ÿäº§ç¯å¢ƒ vs æµ‹è¯•ç¯å¢ƒçš„åŒºåˆ«ï¼š

æ•°æ®è§„æ¨¡ï¼š
æµ‹è¯•ç¯å¢ƒï¼šä¸‡çº§ã€åä¸‡çº§æ•°æ®
ç”Ÿäº§ç¯å¢ƒï¼šåƒä¸‡çº§ã€äº¿çº§æ•°æ®

ä¸šåŠ¡å½±å“ï¼š
æµ‹è¯•ç¯å¢ƒï¼šå½±å“æœ‰é™ï¼Œå¯é‡æ¥
ç”Ÿäº§ç¯å¢ƒï¼šç›´æ¥å½±å“ç”¨æˆ·ï¼Œä¸å¯é€†

ç›‘ç®¡è¦æ±‚ï¼š
æµ‹è¯•ç¯å¢ƒï¼šç›¸å¯¹å®½æ¾
ç”Ÿäº§ç¯å¢ƒï¼šéœ€è¦å®¡æ‰¹ã€è®°å½•ã€å¯è¿½æº¯
```

**ğŸ›¡ï¸ ç”Ÿäº§åˆ é™¤å®‰å…¨ç­–ç•¥**
```python
class ProductionDeleteSafety:
    def __init__(self, connection):
        self.connection = connection
        self.safety_checks = []
        
    def pre_delete_safety_check(self, table_name, condition):
        """åˆ é™¤å‰å®‰å…¨æ£€æŸ¥"""
        cursor = self.connection.cursor()
        
        # 1. æ•°æ®é‡æ£€æŸ¥
        cursor.execute(f"SELECT COUNT(*) FROM {table_name} WHERE {condition}")
        delete_count = cursor.fetchone()[0]
        
        cursor.execute(f"SELECT COUNT(*) FROM {table_name}")
        total_count = cursor.fetchone()[0]
        
        delete_percentage = (delete_count / total_count) * 100
        
        safety_report = {
            'table_name': table_name,
            'total_records': total_count,
            'delete_records': delete_count,
            'delete_percentage': delete_percentage,
            'safety_level': self.assess_safety_level(delete_percentage),
            'recommendations': []
        }
        
        # 2. å®‰å…¨çº§åˆ«è¯„ä¼°
        if delete_percentage > 50:
            safety_report['recommendations'].append("ğŸ”´ å»ºè®®ä½¿ç”¨è¡¨é‡å‘½åæ–¹æ¡ˆ")
        elif delete_percentage > 20:
            safety_report['recommendations'].append("ğŸŸ  å»ºè®®åˆ†å¤šå¤©æ‰§è¡Œ")
        else:
            safety_report['recommendations'].append("ğŸŸ¢ å¯ç›´æ¥åˆ†æ‰¹åˆ é™¤")
            
        # 3. ä¾èµ–å…³ç³»æ£€æŸ¥
        foreign_keys = self.check_foreign_key_constraints(table_name)
        if foreign_keys:
            safety_report['recommendations'].append(f"âš ï¸ æ³¨æ„å¤–é”®çº¦æŸ: {foreign_keys}")
            
        return safety_report
    
    def assess_safety_level(self, percentage):
        if percentage > 50:
            return "ğŸ”´ é«˜é£é™©"
        elif percentage > 20:
            return "ğŸŸ  ä¸­é£é™©"  
        elif percentage > 5:
            return "ğŸŸ¡ ä½é£é™©"
        else:
            return "ğŸŸ¢ å®‰å…¨"
```

### 7.2 ç”Ÿäº§åˆ é™¤æ‰§è¡Œæµç¨‹


**ğŸ“‹ æ ‡å‡†æ‰§è¡Œæµç¨‹**
```
ç”Ÿäº§åˆ é™¤æ ‡å‡†æµç¨‹ï¼š
â”Œâ”€ 1. åˆ é™¤ç”³è¯· â”€â”
â”‚ â€¢ å¡«å†™åˆ é™¤ç”³è¯·è¡¨     â”‚
â”‚ â€¢ è¯´æ˜åˆ é™¤åŸå›        â”‚ 
â”‚ â€¢ è¯„ä¼°å½±å“èŒƒå›´       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€ 2. å®‰å…¨è¯„ä¼° â”€â”  
â”‚ â€¢ æ•°æ®é‡è¯„ä¼°         â”‚
â”‚ â€¢ æ€§èƒ½å½±å“è¯„ä¼°       â”‚
â”‚ â€¢ ä¸šåŠ¡å½±å“è¯„ä¼°       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€ 3. æ–¹æ¡ˆè®¾è®¡ â”€â”
â”‚ â€¢ é€‰æ‹©åˆ é™¤ç­–ç•¥       â”‚
â”‚ â€¢ åˆ¶å®šæ‰§è¡Œè®¡åˆ’       â”‚
â”‚ â€¢ å‡†å¤‡å›æ»šæ–¹æ¡ˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€ 4. å®¡æ‰¹æµç¨‹ â”€â”
â”‚ â€¢ DBAå®¡æ‰¹           â”‚
â”‚ â€¢ ä¸šåŠ¡è´Ÿè´£äººç¡®è®¤     â”‚
â”‚ â€¢ è¿ç»´å›¢é˜Ÿå¤‡æ¡ˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€ 5. æ‰§è¡Œåˆ é™¤ â”€â”
â”‚ â€¢ é€‰æ‹©ä½å³°æœŸæ‰§è¡Œ     â”‚
â”‚ â€¢ å®æ—¶ç›‘æ§æ€§èƒ½       â”‚
â”‚ â€¢ è®°å½•æ‰§è¡Œæ—¥å¿—       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€ 6. åç»­éªŒè¯ â”€â”
â”‚ â€¢ éªŒè¯åˆ é™¤ç»“æœ       â”‚
â”‚ â€¢ æ£€æŸ¥ä¸šåŠ¡åŠŸèƒ½       â”‚
â”‚ â€¢ ç©ºé—´å›æ”¶ç¡®è®¤       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ ç”Ÿäº§åˆ é™¤è„šæœ¬æ¨¡æ¿**
```python
class ProductionBatchDelete:
    def __init__(self, config):
        self.db_config = config['database']
        self.delete_config = config['delete_settings'] 
        self.monitoring = config['monitoring']
        
    def execute_production_delete(self, table_name, condition):
        """ç”Ÿäº§ç¯å¢ƒå®‰å…¨åˆ é™¤"""
        
        # ç¬¬ä¸€æ­¥ï¼šå®‰å…¨æ£€æŸ¥
        safety_report = self.safety_check(table_name, condition)
        if safety_report['safety_level'] == "ğŸ”´ é«˜é£é™©":
            print("â›” é«˜é£é™©æ“ä½œï¼Œè¯·é‡æ–°è¯„ä¼°æ–¹æ¡ˆ")
            return False
            
        # ç¬¬äºŒæ­¥ï¼šè·å–åˆ é™¤è®¸å¯
        if not self.get_delete_approval(safety_report):
            print("âŒ æœªè·å¾—åˆ é™¤è®¸å¯")
            return False
            
        # ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œåˆ é™¤
        try:
            print("ğŸš€ å¼€å§‹æ‰§è¡Œç”Ÿäº§åˆ é™¤...")
            self.perform_monitored_delete(table_name, condition)
            print("âœ… åˆ é™¤ä»»åŠ¡å®Œæˆ")
            return True
            
        except Exception as e:
            print(f"âŒ åˆ é™¤è¿‡ç¨‹å¼‚å¸¸: {e}")
            self.handle_delete_failure(e)
            return False
            
    def perform_monitored_delete(self, table_name, condition):
        """å¸¦ç›‘æ§çš„åˆ é™¤æ‰§è¡Œ"""
        connection = self.get_connection()
        cursor = connection.cursor()
        
        batch_size = self.delete_config['batch_size']
        max_runtime = self.delete_config['max_runtime_hours'] * 3600
        start_time = time.time()
        
        total_deleted = 0
        last_processed_id = 0
        
        while time.time() - start_time < max_runtime:
            # æ‰§è¡Œå•æ‰¹åˆ é™¤
            cursor.execute(f"""
                DELETE FROM {table_name} 
                WHERE id > %s AND {condition}
                ORDER BY id LIMIT %s
            """, (last_processed_id, batch_size))
            
            deleted_count = cursor.rowcount
            if deleted_count == 0:
                break
                
            total_deleted += deleted_count
            connection.commit()
            
            # æ›´æ–°è¿›åº¦
            self.update_progress(total_deleted, last_processed_id)
            
            # æ€§èƒ½ç›‘æ§
            if self.check_performance_threshold():
                print("âš ï¸ æ€§èƒ½é˜ˆå€¼è¶…æ ‡ï¼Œæš‚åœåˆ é™¤")
                time.sleep(10)
                
            # æ‰¹æ¬¡é—´ä¼‘æ¯
            time.sleep(self.delete_config['batch_interval'])
```

### 7.3 åˆ é™¤åçš„ç©ºé—´å›æ”¶


**ğŸ’¾ ç†è§£ç©ºé—´å›æ”¶æœºåˆ¶**
```
åˆ é™¤æ•°æ®åç©ºé—´å»å“ªäº†ï¼Ÿ

InnoDBå­˜å‚¨å¼•æ“ï¼š
â€¢ åˆ é™¤åç©ºé—´æ ‡è®°ä¸º"å¯é‡ç”¨"
â€¢ ä½†æ–‡ä»¶å¤§å°ä¸ä¼šç«‹å³ç¼©å°
â€¢ æ–°æ•°æ®ä¼šä¼˜å…ˆä½¿ç”¨è¿™äº›ç©ºé—´

ä¸ºä»€ä¹ˆä¸ç«‹å³ç¼©å°ï¼Ÿ
â€¢ é¿å…é¢‘ç¹çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
â€¢ ä¸ºåç»­æ•°æ®å¢é•¿é¢„ç•™ç©ºé—´
â€¢ å‡å°‘ç¢ç‰‡æ•´ç†çš„å¼€é”€
```

**ğŸ”§ ä¸»åŠ¨ç©ºé—´å›æ”¶ç­–ç•¥**
```sql
-- æ–¹æ³•1ï¼šè¡¨é‡å»ºï¼ˆæœ€å½»åº•ï¼‰
ALTER TABLE large_table ENGINE=InnoDB;

-- æ–¹æ³•2ï¼šä¼˜åŒ–è¡¨ç»“æ„
OPTIMIZE TABLE large_table;

-- æ–¹æ³•3ï¼šåˆ†æè¡¨ç¢ç‰‡
SELECT 
    table_name,
    data_length,
    index_length,
    data_free,
    (data_free / (data_length + index_length)) * 100 AS fragmentation_pct
FROM information_schema.tables 
WHERE table_schema = 'your_database'
AND table_name = 'large_table';
```

**ğŸ“Š ç©ºé—´å›æ”¶æ•ˆæœç›‘æ§**
```python
def monitor_space_recovery(connection, table_name):
    """ç›‘æ§ç©ºé—´å›æ”¶æ•ˆæœ"""
    cursor = connection.cursor()
    
    # åˆ é™¤å‰åçš„ç©ºé—´å¯¹æ¯”
    cursor.execute("""
        SELECT 
            table_name,
            ROUND(data_length / 1024 / 1024, 2) AS data_size_mb,
            ROUND(index_length / 1024 / 1024, 2) AS index_size_mb,
            ROUND(data_free / 1024 / 1024, 2) AS free_space_mb,
            table_rows
        FROM information_schema.tables 
        WHERE table_schema = DATABASE()
        AND table_name = %s
    """, (table_name,))
    
    result = cursor.fetchone()
    
    space_info = {
        'table_name': result[0],
        'data_size_mb': result[1],
        'index_size_mb': result[2], 
        'free_space_mb': result[3],
        'table_rows': result[4],
        'total_size_mb': result[1] + result[2],
        'fragmentation_pct': (result[3] / (result[1] + result[2] + result[3])) * 100
    }
    
    return space_info
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæŠ€æœ¯


```
ğŸ”¥ **DELETE LIMITåˆ†é¡µåˆ é™¤**
â€¢ æ ¸å¿ƒè¯­æ³•ï¼šDELETE FROM table WHERE condition LIMIT n
â€¢ å¾ªç¯æ‰§è¡Œï¼šé…åˆç¨‹åºå¾ªç¯å®ç°å¤§æ‰¹é‡åˆ é™¤
â€¢ æ‰¹æ¬¡æ§åˆ¶ï¼šæ¯æ‰¹åˆ é™¤1000-5000æ¡è®°å½•

ğŸ”¥ **åˆ é™¤æ‰¹æ¬¡å¤§å°è°ƒä¼˜**  
â€¢ åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®æ‰§è¡Œæ—¶é—´è°ƒæ•´æ‰¹æ¬¡å¤§å°
â€¢ ä¸šåŠ¡é€‚é…ï¼šé«˜å³°æœŸå°æ‰¹æ¬¡ï¼Œä½å³°æœŸå¤§æ‰¹æ¬¡
â€¢ æ€§èƒ½ç›‘æ§ï¼šç›‘æ§é”ç­‰å¾…ã€IOå‹åŠ›ç­‰æŒ‡æ ‡

ğŸ”¥ **åˆ é™¤æ“ä½œæš‚åœæœºåˆ¶**
â€¢ çŠ¶æ€æ§åˆ¶ï¼šæ”¯æŒæš‚åœã€æ¢å¤ã€åœæ­¢æ“ä½œ
â€¢ å¤–éƒ¨å¹²é¢„ï¼šå¯é€šè¿‡ä¿¡å·æˆ–é…ç½®æ§åˆ¶åˆ é™¤è¿‡ç¨‹
â€¢ ä¸šåŠ¡ä¿æŠ¤ï¼šç´§æ€¥æƒ…å†µä¸‹å¿«é€Ÿåœæ­¢åˆ é™¤

ğŸ”¥ **åˆ é™¤è¿›åº¦è·Ÿè¸ª**
â€¢ è¿›åº¦è®°å½•ï¼šå®æ—¶è®°å½•åˆ é™¤è¿›åº¦å’ŒçŠ¶æ€
â€¢ æ—¶é—´é¢„ä¼°ï¼šæ ¹æ®åˆ é™¤é€Ÿåº¦é¢„æµ‹å®Œæˆæ—¶é—´
â€¢ æ–­ç‚¹ç»­ä¼ ï¼šæ”¯æŒä¸­æ–­åä»æ–­ç‚¹ç»§ç»­æ‰§è¡Œ

ğŸ”¥ **å¤§è¡¨åˆ é™¤ç´¢å¼•ç­–ç•¥**
â€¢ ç´¢å¼•è¯„ä¼°ï¼šåˆ é™¤å‰è¯„ä¼°ç´¢å¼•å¯¹æ€§èƒ½çš„å½±å“
â€¢ ç­–ç•¥é€‰æ‹©ï¼šåˆ é™¤å¤§é‡æ•°æ®æ—¶è€ƒè™‘ä¸´æ—¶åˆ é™¤ç´¢å¼•
â€¢ é‡å»ºæ—¶æœºï¼šåˆ é™¤å®Œæˆåé‡å»ºç´¢å¼•
```

### 8.2 æ ¸å¿ƒç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦åˆ†æ‰¹åˆ é™¤**
```
èµ„æºä¿æŠ¤ï¼š
â€¢ é¿å…é•¿æ—¶é—´æŒæœ‰é”
â€¢ æ§åˆ¶äº‹åŠ¡æ—¥å¿—å¤§å°
â€¢ å¹³æ»‘èµ„æºä½¿ç”¨æ›²çº¿

ä¸šåŠ¡è¿ç»­æ€§ï¼š
â€¢ å…¶ä»–æ“ä½œå¯ä»¥ç©¿æ’æ‰§è¡Œ
â€¢ ä¸å½±å“æ­£å¸¸ä¸šåŠ¡æµç¨‹
â€¢ é™ä½ç³»ç»Ÿæ•…éšœé£é™©

å¯æ§æ€§ï¼š
â€¢ å¯ä»¥éšæ—¶æš‚åœæˆ–è°ƒæ•´
â€¢ é—®é¢˜å½±å“èŒƒå›´å¯æ§
â€¢ æ”¯æŒæ¸è¿›å¼å¤„ç†
```

**ğŸ”¹ æ‰¹æ¬¡å¤§å°å¦‚ä½•é€‰æ‹©**
```
å½±å“å› ç´ ï¼š
â€¢ è¡¨çš„è®°å½•æ•°å’Œå¤§å°
â€¢ ç´¢å¼•çš„æ•°é‡å’Œå¤æ‚åº¦
â€¢ ç³»ç»Ÿçš„å¹¶å‘å‹åŠ›
â€¢ ä¸šåŠ¡çš„å®¹å¿åº¦

è°ƒä¼˜åŸåˆ™ï¼š
â€¢ å•æ‰¹æ‰§è¡Œæ—¶é—´æ§åˆ¶åœ¨1-3ç§’å†…
â€¢ é”ç­‰å¾…æ—¶é—´ä¸è¶…è¿‡100æ¯«ç§’
â€¢ äº‹åŠ¡æ—¥å¿—å¢é•¿æ§åˆ¶åœ¨åˆç†èŒƒå›´
â€¢ æ ¹æ®ç›‘æ§æ•°æ®åŠ¨æ€è°ƒæ•´
```

**ğŸ”¹ ä»€ä¹ˆæ—¶å€™éœ€è¦ç‰¹æ®Šæ–¹æ¡ˆ**
```
ä½¿ç”¨åˆ†åŒºåˆ é™¤ï¼š
â€¢ åˆ é™¤æ•°æ®æŒ‰æ—¶é—´ç­‰ç»´åº¦è¿ç»­
â€¢ è¡¨å·²ç»æŒ‰ç›¸åº”ç»´åº¦åˆ†åŒº
â€¢ åˆ é™¤é‡å æ€»é‡æ¯”ä¾‹å¾ˆå¤§

ä½¿ç”¨è¡¨é‡å‘½åï¼š
â€¢ åˆ é™¤æ•°æ® > 50%æ€»é‡
â€¢ å¯ä»¥æ¥å—çŸ­æš‚æœåŠ¡ä¸­æ–­
â€¢ æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´

ä½¿ç”¨ç´¢å¼•ç­–ç•¥ï¼š
â€¢ è¡¨æœ‰å¤šä¸ªéä¸»é”®ç´¢å¼•
â€¢ åˆ é™¤é‡ > 30%æ€»é‡
â€¢ ç´¢å¼•é‡å»ºæ—¶é—´å¯æ¥å—
```

### 8.3 å®æˆ˜ç»éªŒæ€»ç»“


**ğŸ’¼ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**
```
ğŸ¯ **åˆ é™¤å‰å‡†å¤‡**
â€¢ è¯¦ç»†çš„åˆ é™¤è®¡åˆ’å’Œé£é™©è¯„ä¼°
â€¢ å®Œæ•´çš„æ•°æ®å¤‡ä»½
â€¢ æ€§èƒ½ç›‘æ§è„šæœ¬å‡†å¤‡
â€¢ åº”æ€¥å¤„ç†é¢„æ¡ˆ

âš¡ **æ‰§è¡Œè¿‡ç¨‹æ§åˆ¶**
â€¢ é€‰æ‹©ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ
â€¢ å®æ—¶ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
â€¢ ä¿æŒä¸ä¸šåŠ¡å›¢é˜Ÿçš„æ²Ÿé€š
â€¢ éšæ—¶å‡†å¤‡æš‚åœæˆ–å›æ»š

ğŸ”§ **åˆ é™¤åéªŒè¯**
â€¢ éªŒè¯åˆ é™¤ç»“æœçš„æ­£ç¡®æ€§
â€¢ æ£€æŸ¥ä¸šåŠ¡åŠŸèƒ½æ­£å¸¸æ€§
â€¢ ç¡®è®¤ç©ºé—´å›æ”¶æ•ˆæœ
â€¢ æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œè®°å½•
```

**ğŸ“š å­¦ä¹ è·¯å¾„å»ºè®®**
```
ğŸ¥‡ **P0-åŸºç¡€å¿…å¤‡**
â€¢ ç†è§£DELETE LIMITçš„åŸºæœ¬ç”¨æ³•
â€¢ æŒæ¡åˆ†æ‰¹åˆ é™¤çš„å¾ªç¯é€»è¾‘
â€¢ å­¦ä¼šåŸºæœ¬çš„è¿›åº¦ç›‘æ§

ğŸ¥ˆ **P1-è¿›é˜¶æŠ€èƒ½**  
â€¢ åŠ¨æ€æ‰¹æ¬¡å¤§å°è°ƒä¼˜
â€¢ æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦
â€¢ åˆ é™¤ä¸­æ–­æ¢å¤æœºåˆ¶

ğŸ¥‰ **P2-é«˜çº§æŠ€å·§**
â€¢ å¤§è¡¨åˆ é™¤æ–¹æ¡ˆè®¾è®¡
â€¢ ç”Ÿäº§ç¯å¢ƒé£é™©æ§åˆ¶
â€¢ å¤æ‚åœºæ™¯çš„å®šåˆ¶åŒ–æ–¹æ¡ˆ
```

**ğŸ“ å­¦ä¹ å»ºè®®**
```
ç†è®ºå­¦ä¹ ï¼š
â€¢ ç†è§£æ•°æ®åº“é”æœºåˆ¶
â€¢ æŒæ¡äº‹åŠ¡å’Œæ—¥å¿—åŸç†
â€¢ å­¦ä¹ ç´¢å¼•ç»´æŠ¤æœºåˆ¶

å®è·µç»ƒä¹ ï¼š
â€¢ åœ¨æµ‹è¯•ç¯å¢ƒæ¨¡æ‹Ÿå¤§æ‰¹é‡åˆ é™¤
â€¢ å°è¯•ä¸åŒçš„æ‰¹æ¬¡å¤§å°
â€¢ ç»ƒä¹ ç›‘æ§å’Œæ•…éšœå¤„ç†

ç”Ÿäº§åº”ç”¨ï¼š
â€¢ ä»å°è§„æ¨¡åˆ é™¤å¼€å§‹
â€¢ é€æ­¥ç§¯ç´¯ç”Ÿäº§ç»éªŒ
â€¢ å»ºç«‹å›¢é˜Ÿæœ€ä½³å®è·µ
```

**ğŸ’¡ ä¸€å¥è¯ç²¾å**
> å¤§æ‰¹é‡åˆ é™¤çš„ç²¾é«“åœ¨äº"åŒ–æ•´ä¸ºé›¶ï¼Œç¨³æ‰ç¨³æ‰“"â€”â€”é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„åˆ†æ‰¹ç­–ç•¥ï¼Œè®©çœ‹ä¼¼ä¸å¯èƒ½çš„å¤§è§„æ¨¡åˆ é™¤å˜æˆå¯æ§ã€å®‰å…¨ã€é«˜æ•ˆçš„æ—¥å¸¸æ“ä½œã€‚

**ğŸ”‘ è®°å¿†å£è¯€**
```
åˆ†æ‰¹åˆ é™¤æœ‰å¦™æ‹›ï¼š
LIMITæ§åˆ¶æ‰¹æ¬¡å°ï¼Œ
è¿›åº¦ç›‘æ§ä¸å¯å°‘ï¼Œ
æš‚åœæ¢å¤è¦åšå¥½ï¼Œ
ç”Ÿäº§ç¯å¢ƒæ›´éœ€è¦å®‰å…¨ä¿éšœï¼
```