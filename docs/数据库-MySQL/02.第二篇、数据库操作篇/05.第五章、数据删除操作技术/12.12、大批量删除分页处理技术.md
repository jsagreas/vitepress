---
title: 12ã€å¤§æ‰¹é‡åˆ é™¤åˆ†é¡µå¤„ç†æŠ€æœ¯
---
## ğŸ“š ç›®å½•

1. [å¤§æ‰¹é‡åˆ é™¤é¢ä¸´çš„æŒ‘æˆ˜](#1-å¤§æ‰¹é‡åˆ é™¤é¢ä¸´çš„æŒ‘æˆ˜)
2. [åˆ†æ‰¹åˆ é™¤æŠ€æœ¯åŸç†](#2-åˆ†æ‰¹åˆ é™¤æŠ€æœ¯åŸç†)
3. [DELETE LIMITåˆ†é¡µåˆ é™¤å®ç°](#3-delete-limitåˆ†é¡µåˆ é™¤å®ç°)
4. [åˆ é™¤æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#4-åˆ é™¤æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
5. [åˆ é™¤è¿›åº¦ç›‘æ§ä¸æ¢å¤](#5-åˆ é™¤è¿›åº¦ç›‘æ§ä¸æ¢å¤)
6. [å¤§è¡¨åˆ é™¤æ–¹æ¡ˆè®¾è®¡](#6-å¤§è¡¨åˆ é™¤æ–¹æ¡ˆè®¾è®¡)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ å¤§æ‰¹é‡åˆ é™¤é¢ä¸´çš„æŒ‘æˆ˜


### 1.1 ä»€ä¹ˆæ˜¯å¤§æ‰¹é‡åˆ é™¤


**ğŸ”¸ åœºæ™¯æè¿°**
æƒ³è±¡ä¸€ä¸‹ä½ è¦æ¸…ç†ä¸€ä¸ªæœ‰`1000ä¸‡æ¡è®°å½•`çš„ç”¨æˆ·è¡Œä¸ºæ—¥å¿—è¡¨ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œï¼š
```sql
DELETE FROM user_logs WHERE create_time < '2024-01-01';
```

è¿™å°±åƒè¯•å›¾ä¸€å£æ°”æ¬èµ°æ•´æ ‹æ¥¼çš„åƒåœ¾ - ä¸ä»…è€—æ—¶æé•¿ï¼Œè¿˜å¯èƒ½æŠŠæ•´ä¸ªç³»ç»Ÿæ‹–å®ï¼

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
```
ç›´æ¥åˆ é™¤1000ä¸‡æ•°æ® = ä¸€æ¬¡æ€§æ¬èµ°æ•´æ ‹æ¥¼çš„åƒåœ¾
åˆ†æ‰¹åˆ é™¤ = æ¯æ¬¡æ¬ä¸€è½¦åƒåœ¾ï¼Œåˆ†å¤šæ¬¡æ¬å®Œ
```

### 1.2 å¤§æ‰¹é‡åˆ é™¤çš„æ ¸å¿ƒé—®é¢˜


#### ğŸ”¥ **æ€§èƒ½é—®é¢˜**


**é”ç­‰å¾…æ—¶é—´è¿‡é•¿**
```
é—®é¢˜åŸç†ï¼š
æ•°æ®åº“åˆ é™¤æ—¶éœ€è¦åŠ é” â†’ é”å®šæ—¶é—´è¿‡é•¿ â†’ å…¶ä»–æ“ä½œè¢«é˜»å¡

å®é™…å½±å“ï¼š
â€¢ ç”¨æˆ·æŸ¥è¯¢è¶…æ—¶
â€¢ åº”ç”¨ç¨‹åºå“åº”ç¼“æ…¢  
â€¢ æ•´ä¸ªç³»ç»Ÿå‡æ­»çŠ¶æ€

ä¸¥é‡ç¨‹åº¦ï¼šâ˜…â˜…â˜…â˜…â˜…
```

**äº‹åŠ¡æ—¥å¿—æš´å¢**
```
åˆ é™¤100ä¸‡æ¡è®°å½•æ—¶ï¼š
â€¢ äº‹åŠ¡æ—¥å¿—å¯èƒ½å¢é•¿å‡ ä¸ªGB
â€¢ æ—¥å¿—å†™å…¥æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
â€¢ ç£ç›˜ç©ºé—´å¯èƒ½ä¸è¶³

ç±»æ¯”ç†è§£ï¼š
å°±åƒè®°è´¦æ—¶ä¸€æ¬¡æ€§è®°å½•å¤ªå¤šäº¤æ˜“ï¼Œ
è´¦æœ¬å˜å¾—éå¸¸åšé‡ï¼Œç¿»é˜…å›°éš¾
```

#### âš¡ **èµ„æºæ¶ˆè€—é—®é¢˜**


**å†…å­˜å‹åŠ›**
```
å¤§äº‹åŠ¡å†…å­˜å ç”¨ï¼š
åˆ é™¤æ“ä½œ â†’ äº‹åŠ¡ç¼“å†²åŒº â†’ å†…å­˜å ç”¨æ¿€å¢
å¯èƒ½å¯¼è‡´ï¼š
â€¢ å†…å­˜ä¸è¶³
â€¢ ç³»ç»Ÿswapé¢‘ç¹
â€¢ å…¶ä»–æœåŠ¡å—å½±å“
```

**CPUèµ„æºç«äº‰**
```
åˆ é™¤è¿‡ç¨‹ä¸­ï¼š
â€¢ ç´¢å¼•æ›´æ–°æ“ä½œå¯†é›†
â€¢ CPUä½¿ç”¨ç‡é£™å‡
â€¢ å½±å“å…¶ä»–ä¸šåŠ¡å¤„ç†
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦åˆ†æ‰¹å¤„ç†


**ğŸ¯ åˆ†æ‰¹å¤„ç†çš„æ ¸å¿ƒä»·å€¼**

```
â”Œâ”€ ä¼ ç»Ÿä¸€æ¬¡æ€§åˆ é™¤ â”€â”         â”Œâ”€ åˆ†æ‰¹åˆ é™¤å¤„ç† â”€â”
â”‚ é”å®šæ—¶é—´ï¼š2å°æ—¶   â”‚   VS    â”‚ æ¯æ‰¹é”å®šï¼š2ç§’  â”‚
â”‚ å½±å“ä¸šåŠ¡ï¼šä¸¥é‡    â”‚         â”‚ å½±å“ä¸šåŠ¡ï¼šè½»å¾® â”‚
â”‚ å¤±è´¥é£é™©ï¼šé«˜      â”‚         â”‚ å¤±è´¥é£é™©ï¼šä½   â”‚
â”‚ æ¢å¤ä»£ä»·ï¼šå·¨å¤§    â”‚         â”‚ æ¢å¤ä»£ä»·ï¼šå¾ˆå° â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†æ‰¹å¤„ç†çš„ä¼˜åŠ¿ï¼š**
- âœ… **é”æ—¶é—´çŸ­**ï¼šæ¯æ¬¡åªé”å®šå°‘é‡æ•°æ®
- âœ… **å¯ä¸­æ–­**ï¼šå¯ä»¥éšæ—¶æš‚åœå’Œæ¢å¤
- âœ… **é£é™©å¯æ§**ï¼šå•æ‰¹å¤±è´¥ä¸å½±å“å…¨å±€
- âœ… **èµ„æºå¯æ§**ï¼šé¿å…èµ„æºå ç”¨è¿‡å¤š

---

## 2. âš™ï¸ åˆ†æ‰¹åˆ é™¤æŠ€æœ¯åŸç†


### 2.1 åˆ†æ‰¹åˆ é™¤çš„åŸºæœ¬æ€æƒ³


**ğŸ”¸ æ ¸å¿ƒç†å¿µ**
æŠŠ`ä¸€ä¸ªå¤§ä»»åŠ¡`æ‹†åˆ†æˆ`å¤šä¸ªå°ä»»åŠ¡`ï¼Œæ¯æ¬¡åªå¤„ç†ä¸€å°éƒ¨åˆ†æ•°æ®ã€‚

```
åŸå§‹éœ€æ±‚ï¼šåˆ é™¤ 1,000,000 æ¡è®°å½•

åˆ†æ‰¹æ–¹æ¡ˆï¼š
ç¬¬1æ‰¹ï¼šåˆ é™¤ 1-1000 æ¡
ç¬¬2æ‰¹ï¼šåˆ é™¤ 1001-2000 æ¡
ç¬¬3æ‰¹ï¼šåˆ é™¤ 2001-3000 æ¡
...
ç¬¬1000æ‰¹ï¼šåˆ é™¤ 999001-1000000 æ¡

æ¯æ‰¹åªå¤„ç† 1000 æ¡ï¼Œæ€»å…±åˆ† 1000 æ¬¡å®Œæˆ
```

### 2.2 åˆ†æ‰¹åˆ é™¤çš„å·¥ä½œæµç¨‹


**ğŸ“‹ æ ‡å‡†æµç¨‹å›¾**
```
å¼€å§‹åˆ é™¤ä»»åŠ¡
     â†“
ç¡®å®šåˆ é™¤æ¡ä»¶å’Œæ‰¹æ¬¡å¤§å°
     â†“
æ‰§è¡Œå•æ‰¹åˆ é™¤ â† â”€ â”€ â”€ â”€ â”€ â”
     â†“                      â”‚
æ£€æŸ¥å½±å“è¡Œæ•°               â”‚
     â†“                      â”‚
æ˜¯å¦è¿˜æœ‰æ•°æ®éœ€è¦åˆ é™¤ï¼Ÿ â”€ â”€ â”€ â”˜
     â†“ (å¦)
è®°å½•åˆ é™¤å®ŒæˆçŠ¶æ€
     â†“
ä»»åŠ¡ç»“æŸ
```

**ğŸ’» åŸºç¡€å®ç°é€»è¾‘**
```sql
-- åŸºæœ¬çš„åˆ†æ‰¹åˆ é™¤æ¨¡å¼
WHILE (è¿˜æœ‰æ•°æ®éœ€è¦åˆ é™¤) DO
  DELETE FROM table_name 
  WHERE condition 
  LIMIT batch_size;
  
  -- æ£€æŸ¥æœ¬æ‰¹åˆ é™¤äº†å¤šå°‘æ¡
  SET affected_rows = ROW_COUNT();
  
  -- å¦‚æœæ²¡æœ‰åˆ é™¤ä»»ä½•æ•°æ®ï¼Œè¯´æ˜åˆ å®Œäº†
  IF affected_rows = 0 THEN
    BREAK;
  END IF;
  
  -- å¯é€‰ï¼šæš‚åœä¸€æ®µæ—¶é—´ï¼Œå‡å°‘ç³»ç»Ÿå‹åŠ›
  SLEEP(0.1);
END WHILE;
```

### 2.3 å…³é”®å‚æ•°è®¾è®¡


#### ğŸ“Š **æ‰¹æ¬¡å¤§å°é€‰æ‹©**


**ğŸ¯ æ‰¹æ¬¡å¤§å°çš„å½±å“**
```
æ‰¹æ¬¡å¤ªå°ï¼ˆå¦‚100æ¡ï¼‰ï¼š
âœ… é”æ—¶é—´æçŸ­
âœ… å¯¹ä¸šåŠ¡å½±å“å¾ˆå°
âŒ æ€»æ‰§è¡Œæ—¶é—´é•¿
âŒ ç½‘ç»œå¼€é”€å¤§

æ‰¹æ¬¡å¤ªå¤§ï¼ˆå¦‚10ä¸‡æ¡ï¼‰ï¼š
âœ… æ‰§è¡Œæ•ˆç‡é«˜
âŒ é”æ—¶é—´é•¿
âŒ å†…å­˜å ç”¨å¤§
âŒ å›æ»šä»£ä»·é«˜

æœ€ä¼˜é€‰æ‹©ï¼ˆé€šå¸¸1000-5000æ¡ï¼‰ï¼š
ğŸ¯ å¹³è¡¡ç‚¹ï¼šæ•ˆç‡ä¸å½±å“çš„æŠ˜ä¸­
```

**ğŸ“ æ‰¹æ¬¡å¤§å°è®¡ç®—å…¬å¼**
```
ç»éªŒå…¬å¼ï¼š
æœ€ä¼˜æ‰¹æ¬¡å¤§å° = min(
  å¯æ¥å—çš„é”å®šæ—¶é—´ Ã— åˆ é™¤é€Ÿç‡,
  å¯ç”¨å†…å­˜ / å•è¡Œè®°å½•å¤§å°,
  5000  // ä¸€èˆ¬ä¸Šé™
)

å®é™…ä¾‹å­ï¼š
â€¢ é”å®šæ—¶é—´é™åˆ¶ï¼š2ç§’
â€¢ åˆ é™¤é€Ÿç‡ï¼š500æ¡/ç§’
â€¢ è®¡ç®—ç»“æœï¼š2 Ã— 500 = 1000æ¡/æ‰¹
```

---

## 3. ğŸ”§ DELETE LIMITåˆ†é¡µåˆ é™¤å®ç°


### 3.1 åŸºæœ¬DELETE LIMITè¯­æ³•


**ğŸ“ è¯­æ³•ç»“æ„**
```sql
DELETE FROM table_name 
WHERE condition 
ORDER BY column_name  -- å¯é€‰ï¼Œä½†æ¨è
LIMIT number;
```

**ğŸŒ° ç®€å•ç¤ºä¾‹**
```sql
-- åˆ é™¤æœ€è€çš„1000æ¡æ—¥å¿—è®°å½•
DELETE FROM user_logs 
WHERE create_time < '2024-01-01'
ORDER BY create_time ASC
LIMIT 1000;
```

### 3.2 å®Œæ•´çš„åˆ†æ‰¹åˆ é™¤å®ç°


#### ğŸ”„ **å¾ªç¯åˆ é™¤è„šæœ¬**


**MySQLå­˜å‚¨è¿‡ç¨‹å®ç°ï¼š**
```sql
DELIMITER $$

CREATE PROCEDURE BatchDelete(
    IN table_name VARCHAR(100),
    IN where_condition TEXT,
    IN batch_size INT DEFAULT 1000,
    IN sleep_time DECIMAL(3,2) DEFAULT 0.1
)
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE affected_rows INT DEFAULT 0;
    DECLARE total_deleted INT DEFAULT 0;
    DECLARE batch_count INT DEFAULT 0;
    
    -- å¼€å§‹åˆ é™¤å¾ªç¯
    batch_loop: LOOP
        -- æ‰§è¡Œåˆ†æ‰¹åˆ é™¤
        SET @sql = CONCAT(
            'DELETE FROM ', table_name, 
            ' WHERE ', where_condition,
            ' ORDER BY id LIMIT ', batch_size
        );
        
        PREPARE stmt FROM @sql;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
        
        -- è·å–æœ¬æ‰¹åˆ é™¤çš„è¡Œæ•°
        SET affected_rows = ROW_COUNT();
        SET total_deleted = total_deleted + affected_rows;
        SET batch_count = batch_count + 1;
        
        -- è¾“å‡ºè¿›åº¦ä¿¡æ¯
        SELECT CONCAT('æ‰¹æ¬¡: ', batch_count, 
                     ', æœ¬æ‰¹åˆ é™¤: ', affected_rows,
                     ', æ€»åˆ é™¤: ', total_deleted) AS progress;
        
        -- å¦‚æœæ²¡æœ‰åˆ é™¤ä»»ä½•è¡Œï¼Œè¯´æ˜å®Œæˆäº†
        IF affected_rows = 0 THEN
            LEAVE batch_loop;
        END IF;
        
        -- æš‚åœä¸€æ®µæ—¶é—´ï¼Œé‡Šæ”¾ç³»ç»Ÿå‹åŠ›
        DO SLEEP(sleep_time);
        
    END LOOP;
    
    -- è¾“å‡ºæœ€ç»ˆç»“æœ
    SELECT CONCAT('åˆ é™¤å®Œæˆï¼Œæ€»å…±åˆ é™¤ ', total_deleted, ' æ¡è®°å½•ï¼Œåˆ† ', batch_count, ' æ‰¹æ¬¡') AS result;
END$$

DELIMITER ;
```

**è°ƒç”¨ç¤ºä¾‹ï¼š**
```sql
-- åˆ é™¤2024å¹´å‰çš„æ‰€æœ‰æ—¥å¿—ï¼Œæ¯æ‰¹1000æ¡ï¼Œé—´éš”0.1ç§’
CALL BatchDelete(
    'user_logs', 
    'create_time < "2024-01-01"', 
    1000, 
    0.1
);
```

#### ğŸ **Pythonè„šæœ¬å®ç°**


```python
import time
import pymysql
from typing import Tuple

class BatchDeleter:
    def __init__(self, connection_config: dict):
        self.connection = pymysql.connect(**connection_config)
        self.cursor = self.connection.cursor()
    
    def batch_delete(self, 
                    table: str, 
                    condition: str, 
                    batch_size: int = 1000,
                    sleep_time: float = 0.1,
                    max_batches: int = None) -> dict:
        """
        åˆ†æ‰¹åˆ é™¤æ•°æ®
        
        Args:
            table: è¡¨å
            condition: WHEREæ¡ä»¶
            batch_size: æ¯æ‰¹åˆ é™¤æ•°é‡
            sleep_time: æ‰¹æ¬¡é—´æš‚åœæ—¶é—´ï¼ˆç§’ï¼‰
            max_batches: æœ€å¤§æ‰¹æ¬¡æ•°ï¼ˆé˜²æ­¢æ„å¤–ï¼‰
        
        Returns:
            åˆ é™¤ç»Ÿè®¡ä¿¡æ¯
        """
        total_deleted = 0
        batch_count = 0
        
        print(f"ğŸš€ å¼€å§‹åˆ†æ‰¹åˆ é™¤ï¼Œæ¯æ‰¹ {batch_size} æ¡")
        
        try:
            while True:
                # æ£€æŸ¥æœ€å¤§æ‰¹æ¬¡é™åˆ¶
                if max_batches and batch_count >= max_batches:
                    print(f"âš ï¸ è¾¾åˆ°æœ€å¤§æ‰¹æ¬¡é™åˆ¶ {max_batches}")
                    break
                
                # æ‰§è¡Œåˆ†æ‰¹åˆ é™¤
                sql = f"""
                DELETE FROM {table} 
                WHERE {condition} 
                ORDER BY id 
                LIMIT {batch_size}
                """
                
                affected_rows = self.cursor.execute(sql)
                self.connection.commit()
                
                # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                total_deleted += affected_rows
                batch_count += 1
                
                # æ˜¾ç¤ºè¿›åº¦
                print(f"ğŸ“Š æ‰¹æ¬¡ {batch_count}: åˆ é™¤ {affected_rows} æ¡ï¼Œç´¯è®¡ {total_deleted} æ¡")
                
                # å¦‚æœæœ¬æ‰¹æ²¡æœ‰åˆ é™¤ä»»ä½•æ•°æ®ï¼Œè¯´æ˜å®Œæˆäº†
                if affected_rows == 0:
                    print("âœ… åˆ é™¤å®Œæˆï¼Œæ²¡æœ‰æ›´å¤šæ•°æ®")
                    break
                
                # æš‚åœï¼Œç»™ç³»ç»Ÿå–˜æ¯æ—¶é—´
                if sleep_time > 0:
                    time.sleep(sleep_time)
                    
        except Exception as e:
            print(f"âŒ åˆ é™¤è¿‡ç¨‹ä¸­å‡ºé”™: {e}")
            self.connection.rollback()
            raise
        
        return {
            'total_deleted': total_deleted,
            'batch_count': batch_count,
            'status': 'completed'
        }

# ä½¿ç”¨ç¤ºä¾‹
config = {
    'host': 'localhost',
    'user': 'root', 
    'password': 'password',
    'database': 'test_db'
}

deleter = BatchDeleter(config)
result = deleter.batch_delete(
    table='user_logs',
    condition='create_time < "2024-01-01"',
    batch_size=2000,
    sleep_time=0.05
)

print(f"ğŸ‰ ä»»åŠ¡å®Œæˆï¼š{result}")
```

### 3.3 ORDER BYçš„é‡è¦æ€§


**â— ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨ORDER BY**

```
æ²¡æœ‰ORDER BYçš„é—®é¢˜ï¼š
DELETE FROM table WHERE condition LIMIT 1000;

é—®é¢˜ï¼šæ¯æ¬¡åˆ é™¤çš„å¯èƒ½æ˜¯éšæœºçš„1000æ¡
ç»“æœï¼š
â€¢ å¯èƒ½é‡å¤æ‰«æç›¸åŒæ•°æ®
â€¢ åˆ é™¤æ•ˆç‡ä¸ç¨³å®š
â€¢ æ— æ³•é¢„æµ‹åˆ é™¤è¿›åº¦

æ¨èåšæ³•ï¼š
DELETE FROM table WHERE condition 
ORDER BY id ASC LIMIT 1000;

ä¼˜åŠ¿ï¼š
â€¢ æ¯æ¬¡éƒ½ä»æœ€å°IDå¼€å§‹åˆ é™¤
â€¢ åˆ é™¤é¡ºåºå¯é¢„æµ‹
â€¢ åˆ©ç”¨ç´¢å¼•æå‡æ•ˆç‡
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”å®æµ‹**
| åˆ é™¤æ–¹å¼ | **100ä¸‡æ•°æ®åˆ é™¤æ—¶é—´** | **CPUä½¿ç”¨ç‡** | **é”ç­‰å¾…** |
|---------|---------------------|-------------|----------|
| ğŸš« **ç›´æ¥åˆ é™¤** | `45åˆ†é’Ÿ` | `95%æŒç»­` | `ä¸¥é‡é˜»å¡` |
| âš¡ **åˆ†æ‰¹+ORDER BY** | `15åˆ†é’Ÿ` | `30%é—´æ­‡` | `å‡ ä¹æ— é˜»å¡` |
| ğŸŒ **åˆ†æ‰¹æ— ORDER BY** | `25åˆ†é’Ÿ` | `60%é—´æ­‡` | `è½»å¾®é˜»å¡` |

---

## 4. ğŸš€ åˆ é™¤æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 4.1 é”ç­‰å¾…æ§åˆ¶æŠ€æœ¯


#### â° **é”ç­‰å¾…æ—¶é—´ä¼˜åŒ–**


**æ ¸å¿ƒæ€æƒ³ï¼šè®©å…¶ä»–æ“ä½œæœ‰æœºä¼šæ‰§è¡Œ**

```sql
-- è®¾ç½®é”ç­‰å¾…è¶…æ—¶æ—¶é—´
SET innodb_lock_wait_timeout = 5;  -- 5ç§’è¶…æ—¶

-- åˆ†æ‰¹åˆ é™¤æ¨¡æ¿
DELETE FROM user_logs 
WHERE create_time < '2024-01-01'
AND id BETWEEN 1 AND 1000
ORDER BY id LIMIT 1000;

-- æ¯æ‰¹ä¹‹é—´æš‚åœ
SELECT SLEEP(0.1);  -- æš‚åœ0.1ç§’
```

**ğŸ”§ é”ç²’åº¦æ§åˆ¶**
```
è¡Œé” vs è¡¨é”çš„é€‰æ‹©ï¼š

ä½¿ç”¨WHEREæ¡ä»¶ + ORDER BY + LIMITï¼š
âœ… åªé”å®šè¦åˆ é™¤çš„è¡Œ
âœ… å…¶ä»–è¡Œä»å¯æ­£å¸¸è®¿é—®
âœ… é”å½±å“èŒƒå›´æœ€å°

é¿å…çš„åšæ³•ï¼š
âŒ æ²¡æœ‰WHEREæ¡ä»¶ï¼ˆé”å…¨è¡¨ï¼‰
âŒ æ¡ä»¶å¤ªå®½æ³›ï¼ˆé”å®šèŒƒå›´å¤§ï¼‰
âŒ æ²¡æœ‰åˆé€‚ç´¢å¼•ï¼ˆæ‰«æé”å®šï¼‰
```

### 4.2 äº‹åŠ¡å¤§å°æ§åˆ¶


#### ğŸ“¦ **äº‹åŠ¡æ‰¹æ¬¡è®¾è®¡**


**äº‹åŠ¡å¤§å°çš„å¹³è¡¡**
```
ğŸŸ¢ å°äº‹åŠ¡ï¼ˆ1000æ¡/äº‹åŠ¡ï¼‰ï¼š
ä¼˜ç‚¹ï¼š
â€¢ é”å®šæ—¶é—´çŸ­
â€¢ å›æ»šä»£ä»·å°
â€¢ å¯¹å…¶ä»–æ“ä½œå½±å“å°

ç¼ºç‚¹ï¼š
â€¢ äº‹åŠ¡å¼€é”€ç›¸å¯¹è¾ƒå¤§
â€¢ æ€»æ‰§è¡Œæ—¶é—´å¯èƒ½è¾ƒé•¿

ğŸŸ¡ å¤§äº‹åŠ¡ï¼ˆ10000æ¡/äº‹åŠ¡ï¼‰ï¼š
ä¼˜ç‚¹ï¼š
â€¢ äº‹åŠ¡å¼€é”€å°
â€¢ åˆ é™¤æ•ˆç‡é«˜

ç¼ºç‚¹ï¼š
â€¢ é”å®šæ—¶é—´é•¿
â€¢ å†…å­˜å ç”¨å¤§
â€¢ å¤±è´¥å›æ»šä»£ä»·é«˜

ğŸ¯ æ¨èåšæ³•ï¼š1000-5000æ¡/äº‹åŠ¡
```

**ğŸ”„ äº‹åŠ¡è¾¹ç•Œæ§åˆ¶**
```python
def controlled_batch_delete(cursor, table, condition, batch_size=1000):
    """äº‹åŠ¡å¤§å°å¯æ§çš„åˆ†æ‰¹åˆ é™¤"""
    
    while True:
        # å¼€å§‹æ–°äº‹åŠ¡
        cursor.execute("START TRANSACTION")
        
        try:
            # åˆ é™¤ä¸€æ‰¹æ•°æ®
            sql = f"""
            DELETE FROM {table} 
            WHERE {condition} 
            ORDER BY id 
            LIMIT {batch_size}
            """
            
            affected = cursor.execute(sql)
            
            # æäº¤äº‹åŠ¡
            cursor.execute("COMMIT")
            
            print(f"âœ… åˆ é™¤ {affected} æ¡è®°å½•")
            
            # æ²¡æœ‰æ•°æ®äº†å°±ç»“æŸ
            if affected == 0:
                break
                
            # ç»™ç³»ç»Ÿä¼‘æ¯æ—¶é—´
            time.sleep(0.1)
            
        except Exception as e:
            # å‡ºé”™æ—¶å›æ»š
            cursor.execute("ROLLBACK")
            print(f"âŒ æ‰¹æ¬¡åˆ é™¤å¤±è´¥: {e}")
            break
```

### 4.3 ç´¢å¼•ç­–ç•¥ä¼˜åŒ–


#### ğŸ¯ **åˆ é™¤æ“ä½œçš„ç´¢å¼•é€‰æ‹©**


**åˆ é™¤æ¡ä»¶ç´¢å¼•**
```sql
-- å‡è®¾ç»å¸¸æŒ‰æ—¶é—´åˆ é™¤
ALTER TABLE user_logs 
ADD INDEX idx_create_time (create_time);

-- åˆ é™¤æ—¶åˆ©ç”¨æ—¶é—´ç´¢å¼•
DELETE FROM user_logs 
WHERE create_time < '2024-01-01'
ORDER BY create_time ASC  -- åˆ©ç”¨ç´¢å¼•æ’åº
LIMIT 1000;
```

**å¤åˆç´¢å¼•ä¼˜åŒ–**
```sql
-- å¦‚æœåˆ é™¤æ¡ä»¶å¤æ‚
WHERE user_id = 12345 AND create_time < '2024-01-01'

-- å»ºç«‹å¤åˆç´¢å¼•
ALTER TABLE user_logs 
ADD INDEX idx_user_time (user_id, create_time);

-- åˆ é™¤æ—¶å®Œå…¨åˆ©ç”¨ç´¢å¼•
DELETE FROM user_logs 
WHERE user_id = 12345 AND create_time < '2024-01-01'
ORDER BY user_id, create_time  -- å®Œå…¨åŒ¹é…ç´¢å¼•
LIMIT 1000;
```

#### ğŸ“ˆ **ç´¢å¼•å¯¹åˆ é™¤æ€§èƒ½çš„å½±å“**


| ç´¢å¼•æƒ…å†µ | **æ‰«ææ–¹å¼** | **åˆ é™¤é€Ÿåº¦** | **é”å®šèŒƒå›´** |
|---------|-------------|-------------|-------------|
| ğŸš« **æ— ç´¢å¼•** | `å…¨è¡¨æ‰«æ` | `å¾ˆæ…¢` | `å¤§èŒƒå›´é”å®š` |
| âš¡ **å•åˆ—ç´¢å¼•** | `ç´¢å¼•æ‰«æ` | `è¾ƒå¿«` | `ç²¾ç¡®é”å®š` |
| ğŸ¯ **å¤åˆç´¢å¼•** | `ç´¢å¼•ç›´æ¥å®šä½` | `æœ€å¿«` | `æœ€å°é”å®š` |

---

## 5. ğŸ“Š åˆ é™¤è¿›åº¦ç›‘æ§ä¸æ¢å¤


### 5.1 åˆ é™¤è¿›åº¦è·Ÿè¸ª


#### ğŸ“ˆ **å®æ—¶è¿›åº¦è®¡ç®—**


**è¿›åº¦è·Ÿè¸ªçš„æ ¸å¿ƒæ€è·¯**
```sql
-- 1. å…ˆç»Ÿè®¡è¦åˆ é™¤çš„æ€»æ•°
SELECT COUNT(*) as total_count 
FROM user_logs 
WHERE create_time < '2024-01-01';

-- å‡è®¾ç»“æœæ˜¯ 1,500,000 æ¡

-- 2. åˆ é™¤è¿‡ç¨‹ä¸­è·Ÿè¸ªå‰©ä½™æ•°é‡
SELECT COUNT(*) as remaining_count 
FROM user_logs 
WHERE create_time < '2024-01-01';

-- è®¡ç®—è¿›åº¦ï¼š(æ€»æ•° - å‰©ä½™æ•°) / æ€»æ•° Ã— 100%
```

**ğŸ Pythonè¿›åº¦ç›‘æ§å®ç°**
```python
class ProgressTracker:
    def __init__(self, table, condition, cursor):
        # è®¡ç®—æ€»æ•°ï¼ˆåªè®¡ç®—ä¸€æ¬¡ï¼‰
        cursor.execute(f"SELECT COUNT(*) FROM {table} WHERE {condition}")
        self.total_count = cursor.fetchone()[0]
        self.deleted_count = 0
        self.start_time = time.time()
        
        print(f"ğŸ“Š æ€»å…±éœ€è¦åˆ é™¤ {self.total_count:,} æ¡è®°å½•")
    
    def update_progress(self, batch_deleted):
        self.deleted_count += batch_deleted
        
        # è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
        progress = (self.deleted_count / self.total_count) * 100
        
        # è®¡ç®—é¢„ä¼°å‰©ä½™æ—¶é—´
        elapsed = time.time() - self.start_time
        if self.deleted_count > 0:
            rate = self.deleted_count / elapsed  # æ¡/ç§’
            remaining = self.total_count - self.deleted_count
            eta = remaining / rate if rate > 0 else 0
            
            print(f"ğŸ”„ è¿›åº¦: {progress:.1f}% "
                  f"({self.deleted_count:,}/{self.total_count:,}) "
                  f"é¢„è®¡å‰©ä½™: {eta/60:.1f}åˆ†é’Ÿ")

# ä½¿ç”¨ç¤ºä¾‹
tracker = ProgressTracker('user_logs', 'create_time < "2024-01-01"', cursor)

while True:
    # æ‰§è¡Œæ‰¹é‡åˆ é™¤
    affected = cursor.execute(delete_sql)
    
    if affected == 0:
        break
        
    # æ›´æ–°è¿›åº¦
    tracker.update_progress(affected)
    time.sleep(0.1)
```

### 5.2 åˆ é™¤ä¸­æ–­æ¢å¤æœºåˆ¶


#### ğŸ’¾ **æ–­ç‚¹ç»­ä¼ è®¾è®¡**


**æ ¸å¿ƒæ€æƒ³ï¼šè®°å½•åˆ é™¤ä½ç½®ï¼Œæ”¯æŒä»ä¸­æ–­ç‚¹ç»§ç»­**

```python
class ResumableDeleter:
    def __init__(self, connection_config, checkpoint_file='delete_progress.json'):
        self.connection = pymysql.connect(**connection_config)
        self.cursor = self.connection.cursor()
        self.checkpoint_file = checkpoint_file
    
    def save_checkpoint(self, last_deleted_id, total_deleted):
        """ä¿å­˜åˆ é™¤è¿›åº¦"""
        checkpoint = {
            'last_deleted_id': last_deleted_id,
            'total_deleted': total_deleted,
            'timestamp': time.time()
        }
        
        with open(self.checkpoint_file, 'w') as f:
            json.dump(checkpoint, f)
        
        print(f"ğŸ’¾ ä¿å­˜è¿›åº¦ï¼šå·²åˆ é™¤åˆ°ID {last_deleted_id}")
    
    def load_checkpoint(self):
        """åŠ è½½åˆ é™¤è¿›åº¦"""
        try:
            with open(self.checkpoint_file, 'r') as f:
                return json.load(f)
        except FileNotFoundError:
            return {'last_deleted_id': 0, 'total_deleted': 0}
    
    def resumable_delete(self, table, base_condition, batch_size=1000):
        """å¯æ¢å¤çš„åˆ†æ‰¹åˆ é™¤"""
        
        # åŠ è½½ä¸Šæ¬¡çš„è¿›åº¦
        checkpoint = self.load_checkpoint()
        start_id = checkpoint['last_deleted_id']
        total_deleted = checkpoint['total_deleted']
        
        print(f"ğŸ”„ ä»ID {start_id} ç»§ç»­åˆ é™¤")
        
        while True:
            # æ„å»ºåˆ é™¤æ¡ä»¶ï¼ˆä»ä¸Šæ¬¡ä½ç½®ç»§ç»­ï¼‰
            sql = f"""
            DELETE FROM {table} 
            WHERE {base_condition} AND id > {start_id}
            ORDER BY id ASC 
            LIMIT {batch_size}
            """
            
            # æ‰§è¡Œåˆ é™¤
            affected = self.cursor.execute(sql)
            self.connection.commit()
            
            if affected == 0:
                print("âœ… åˆ é™¤å®Œæˆ")
                break
            
            # è·å–æœ¬æ‰¹åˆ é™¤çš„æœ€å¤§ID
            self.cursor.execute(f"""
                SELECT MAX(id) FROM {table} 
                WHERE {base_condition} AND id <= {start_id + batch_size}
            """)
            
            result = self.cursor.fetchone()
            if result and result[0]:
                start_id = result[0]
            
            total_deleted += affected
            
            # æ¯10æ‰¹ä¿å­˜ä¸€æ¬¡è¿›åº¦
            if total_deleted % (batch_size * 10) == 0:
                self.save_checkpoint(start_id, total_deleted)
            
            time.sleep(0.1)
        
        # åˆ é™¤è¿›åº¦æ–‡ä»¶
        os.remove(self.checkpoint_file)
        return total_deleted
```

### 5.3 åˆ é™¤æ“ä½œæš‚åœæœºåˆ¶


#### â¸ï¸ **æ™ºèƒ½æš‚åœæ§åˆ¶**


**åŸºäºç³»ç»Ÿè´Ÿè½½çš„æš‚åœ**
```python
import psutil

class SmartDeleter:
    def __init__(self, max_cpu_percent=70, max_memory_percent=80):
        self.max_cpu = max_cpu_percent
        self.max_memory = max_memory_percent
    
    def should_pause(self):
        """æ£€æŸ¥æ˜¯å¦éœ€è¦æš‚åœåˆ é™¤"""
        cpu_percent = psutil.cpu_percent(interval=1)
        memory_percent = psutil.virtual_memory().percent
        
        if cpu_percent > self.max_cpu:
            print(f"â¸ï¸ CPUä½¿ç”¨ç‡è¿‡é«˜ ({cpu_percent:.1f}%)ï¼Œæš‚åœåˆ é™¤")
            return True
            
        if memory_percent > self.max_memory:
            print(f"â¸ï¸ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ({memory_percent:.1f}%)ï¼Œæš‚åœåˆ é™¤")
            return True
            
        return False
    
    def adaptive_batch_delete(self, cursor, sql_template, batch_size):
        """è‡ªé€‚åº”çš„æ‰¹é‡åˆ é™¤"""
        current_batch_size = batch_size
        
        while True:
            # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
            if self.should_pause():
                print("ğŸ˜´ ç­‰å¾…ç³»ç»Ÿè´Ÿè½½é™ä½...")
                time.sleep(5)
                continue
            
            # æ‰§è¡Œåˆ é™¤
            sql = sql_template.format(limit=current_batch_size)
            affected = cursor.execute(sql)
            
            if affected == 0:
                break
            
            # æ ¹æ®ç³»ç»ŸçŠ¶æ€è°ƒæ•´æ‰¹æ¬¡å¤§å°
            if psutil.cpu_percent() < 30:
                # ç³»ç»Ÿç©ºé—²ï¼Œå¯ä»¥å¢åŠ æ‰¹æ¬¡å¤§å°
                current_batch_size = min(current_batch_size * 1.2, batch_size * 2)
            elif psutil.cpu_percent() > 60:
                # ç³»ç»Ÿç¹å¿™ï¼Œå‡å°‘æ‰¹æ¬¡å¤§å°
                current_batch_size = max(current_batch_size * 0.8, batch_size * 0.5)
            
            print(f"ğŸ“Š åˆ é™¤ {affected} æ¡ï¼Œå½“å‰æ‰¹æ¬¡å¤§å°ï¼š{int(current_batch_size)}")
            time.sleep(0.1)
```

---

## 6. ğŸ—ƒï¸ å¤§è¡¨åˆ é™¤æ–¹æ¡ˆè®¾è®¡


### 6.1 å¤§è¡¨åˆ é™¤çš„æŒ‘æˆ˜åˆ†æ


**ğŸ“Š å¤§è¡¨ç‰¹å¾**
```
å¤§è¡¨å®šä¹‰ï¼š
â€¢ æ•°æ®é‡ï¼š1000ä¸‡+ è®°å½•
â€¢ å­˜å‚¨å¤§å°ï¼š10GB+ ç©ºé—´
â€¢ ç´¢å¼•å¤æ‚ï¼šå¤šä¸ªå¤åˆç´¢å¼•
â€¢ ä¸šåŠ¡é‡è¦ï¼š7Ã—24å°æ—¶ä½¿ç”¨

æŒ‘æˆ˜ï¼š
ğŸ”¥ åˆ é™¤æ—¶é—´é•¿ï¼šå¯èƒ½éœ€è¦å‡ å°æ—¶
ğŸ”¥ é”å½±å“å¤§ï¼šå½±å“ä¸šåŠ¡æ­£å¸¸è¿è¡Œ
ğŸ”¥ å›æ»šå›°éš¾ï¼šä¸€æ—¦å¤±è´¥å¾ˆéš¾æ¢å¤
ğŸ”¥ èµ„æºæ¶ˆè€—ï¼šå†…å­˜ã€CPUã€ç£ç›˜IOéƒ½å¾ˆé«˜
```

### 6.2 å¤§è¡¨åˆ é™¤ç´¢å¼•ç­–ç•¥


#### ğŸ¯ **åˆ é™¤ä¸“ç”¨ç´¢å¼•è®¾è®¡**


**ä¸´æ—¶ç´¢å¼•ç­–ç•¥**
```sql
-- åˆ é™¤å‰ï¼šåˆ›å»ºåˆ é™¤ä¸“ç”¨ç´¢å¼•
ALTER TABLE user_logs 
ADD INDEX idx_delete_temp (create_time, id);

-- æ‰§è¡Œåˆ†æ‰¹åˆ é™¤
DELETE FROM user_logs 
WHERE create_time < '2024-01-01'
ORDER BY create_time, id 
LIMIT 2000;

-- åˆ é™¤åï¼šç§»é™¤ä¸´æ—¶ç´¢å¼•ï¼ˆå¯é€‰ï¼‰
ALTER TABLE user_logs 
DROP INDEX idx_delete_temp;
```

**ğŸ“‹ ç´¢å¼•é€‰æ‹©åŸåˆ™**
```
åˆ é™¤æ¡ä»¶åˆ†æï¼š
WHERE create_time < '2024-01-01' AND user_type = 'inactive'

ç´¢å¼•è®¾è®¡é€‰æ‹©ï¼š
æ–¹æ¡ˆ1ï¼š(create_time, user_type, id)  â† æ¨è
æ–¹æ¡ˆ2ï¼š(user_type, create_time, id)  
æ–¹æ¡ˆ3ï¼š(create_time) + (user_type)

é€‰æ‹©ç†ç”±ï¼š
âœ… æ–¹æ¡ˆ1ï¼šåˆ é™¤æ¡ä»¶å®Œå…¨åŒ¹é…ç´¢å¼•é¡ºåº
âœ… åŒ…å«idï¼šæ”¯æŒORDER BYä¼˜åŒ–
âœ… é€‰æ‹©æ€§å¥½ï¼šæ—¶é—´æ¡ä»¶é€šå¸¸é€‰æ‹©æ€§è¾ƒé«˜
```

### 6.3 åˆ†åŒºè¡¨åˆ é™¤ç­–ç•¥


#### ğŸ—‚ï¸ **åˆ†åŒºåˆ é™¤ä¼˜åŒ–**


**åˆ†åŒºè¡¨çš„ä¼˜åŠ¿**
```
ä¼ ç»Ÿåˆ é™¤ï¼š
DELETE FROM logs WHERE create_time < '2024-01-01';
éœ€è¦æ‰«ææ•´ä¸ªè¡¨ï¼Œåˆ é™¤åˆ†æ•£çš„è®°å½•

åˆ†åŒºè¡¨åˆ é™¤ï¼š
ALTER TABLE logs DROP PARTITION p_2023_q1;
ç›´æ¥åˆ é™¤æ•´ä¸ªåˆ†åŒºï¼Œé€Ÿåº¦æå¿«

æ€§èƒ½å¯¹æ¯”ï¼š
ä¼ ç»Ÿåˆ é™¤ï¼š2å°æ—¶
åˆ†åŒºåˆ é™¤ï¼š2ç§’
```

**ğŸ—ï¸ åˆ†åŒºè¡¨è®¾è®¡ç¤ºä¾‹**
```sql
-- æŒ‰æœˆåˆ†åŒºçš„æ—¥å¿—è¡¨
CREATE TABLE user_logs (
    id BIGINT AUTO_INCREMENT,
    user_id INT,
    action VARCHAR(100),
    create_time DATETIME,
    PRIMARY KEY (id, create_time)  -- åˆ†åŒºé”®å¿…é¡»åŒ…å«åœ¨ä¸»é”®ä¸­
)
PARTITION BY RANGE (YEAR(create_time) * 100 + MONTH(create_time)) (
    PARTITION p_202301 VALUES LESS THAN (202302),
    PARTITION p_202302 VALUES LESS THAN (202303),
    PARTITION p_202303 VALUES LESS THAN (202304),
    -- ...
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- åˆ é™¤2023å¹´1æœˆçš„æ‰€æœ‰æ•°æ®
ALTER TABLE user_logs DROP PARTITION p_202301;
```

### 6.4 åˆ é™¤æ‰¹æ¬¡å¤§å°è°ƒä¼˜


#### âš–ï¸ **åŠ¨æ€æ‰¹æ¬¡å¤§å°ç®—æ³•**


**è‡ªé€‚åº”æ‰¹æ¬¡å¤§å°**
```python
class AdaptiveBatchSize:
    def __init__(self, initial_size=1000, target_time=2.0):
        self.current_size = initial_size
        self.target_time = target_time  # ç›®æ ‡ï¼šæ¯æ‰¹2ç§’å®Œæˆ
        self.performance_history = []
    
    def adjust_batch_size(self, actual_time, affected_rows):
        """æ ¹æ®å®é™…æ€§èƒ½è°ƒæ•´æ‰¹æ¬¡å¤§å°"""
        
        # è®°å½•æ€§èƒ½æ•°æ®
        if affected_rows > 0:
            rate = affected_rows / actual_time  # æ¡/ç§’
            self.performance_history.append(rate)
        
        # ä¿æŒæœ€è¿‘10æ¬¡çš„æ€§èƒ½æ•°æ®
        if len(self.performance_history) > 10:
            self.performance_history.pop(0)
        
        # è°ƒæ•´ç­–ç•¥
        if actual_time < self.target_time * 0.5:
            # å¤ªå¿«äº†ï¼Œå¯ä»¥å¢åŠ æ‰¹æ¬¡å¤§å°
            self.current_size = int(self.current_size * 1.3)
            print(f"ğŸ“ˆ å¢åŠ æ‰¹æ¬¡å¤§å°åˆ° {self.current_size}")
            
        elif actual_time > self.target_time * 2:
            # å¤ªæ…¢äº†ï¼Œå‡å°‘æ‰¹æ¬¡å¤§å°
            self.current_size = int(self.current_size * 0.7)
            print(f"ğŸ“‰ å‡å°‘æ‰¹æ¬¡å¤§å°åˆ° {self.current_size}")
        
        # é™åˆ¶åœ¨åˆç†èŒƒå›´å†…
        self.current_size = max(100, min(self.current_size, 10000))
        
        return self.current_size

# ä½¿ç”¨ç¤ºä¾‹
adaptive = AdaptiveBatchSize(initial_size=1000, target_time=2.0)

while True:
    start_time = time.time()
    
    # æ‰§è¡Œåˆ é™¤
    affected = cursor.execute(f"DELETE ... LIMIT {adaptive.current_size}")
    
    if affected == 0:
        break
    
    # è°ƒæ•´æ‰¹æ¬¡å¤§å°
    elapsed = time.time() - start_time
    new_size = adaptive.adjust_batch_size(elapsed, affected)
    
    time.sleep(0.1)
```

### 6.5 åˆ é™¤çŠ¶æ€æŒä¹…åŒ–


#### ğŸ’¾ **åˆ é™¤çŠ¶æ€è®°å½•è¡¨**


**çŠ¶æ€è·Ÿè¸ªè¡¨è®¾è®¡**
```sql
CREATE TABLE delete_job_status (
    job_id VARCHAR(50) PRIMARY KEY,
    table_name VARCHAR(100),
    delete_condition TEXT,
    total_estimated INT,
    deleted_count INT DEFAULT 0,
    last_deleted_id BIGINT DEFAULT 0,
    batch_size INT,
    status ENUM('running', 'paused', 'completed', 'failed'),
    start_time DATETIME,
    last_update DATETIME,
    error_message TEXT
);
```

**ğŸ”„ çŠ¶æ€ç®¡ç†å®ç°**
```python
class PersistentBatchDeleter:
    def __init__(self, connection, job_id):
        self.connection = connection
        self.cursor = connection.cursor()
        self.job_id = job_id
    
    def start_delete_job(self, table, condition, batch_size=1000):
        """å¼€å§‹æ–°çš„åˆ é™¤ä»»åŠ¡"""
        
        # ä¼°ç®—æ€»æ•°
        self.cursor.execute(f"SELECT COUNT(*) FROM {table} WHERE {condition}")
        total_estimated = self.cursor.fetchone()[0]
        
        # è®°å½•ä»»åŠ¡çŠ¶æ€
        self.cursor.execute("""
            INSERT INTO delete_job_status 
            (job_id, table_name, delete_condition, total_estimated, 
             batch_size, status, start_time, last_update)
            VALUES (%s, %s, %s, %s, %s, 'running', NOW(), NOW())
        """, (self.job_id, table, condition, total_estimated, batch_size))
        
        self.connection.commit()
        print(f"ğŸš€ å¯åŠ¨åˆ é™¤ä»»åŠ¡ {self.job_id}")
        
        return self.execute_batch_delete(table, condition, batch_size)
    
    def resume_delete_job(self):
        """æ¢å¤ä¸­æ–­çš„åˆ é™¤ä»»åŠ¡"""
        
        # åŠ è½½ä»»åŠ¡çŠ¶æ€
        self.cursor.execute("""
            SELECT table_name, delete_condition, batch_size, 
                   last_deleted_id, deleted_count
            FROM delete_job_status 
            WHERE job_id = %s
        """, (self.job_id,))
        
        job_info = self.cursor.fetchone()
        if not job_info:
            print(f"âŒ æ‰¾ä¸åˆ°ä»»åŠ¡ {self.job_id}")
            return
        
        table, condition, batch_size, last_id, deleted_count = job_info
        
        print(f"ğŸ”„ æ¢å¤ä»»åŠ¡ {self.job_id}ï¼Œä»ID {last_id} ç»§ç»­")
        
        # ä¿®æ”¹åˆ é™¤æ¡ä»¶ï¼Œä»ä¸Šæ¬¡ä½ç½®ç»§ç»­
        resume_condition = f"({condition}) AND id > {last_id}"
        
        return self.execute_batch_delete(table, resume_condition, batch_size, deleted_count)
    
    def update_progress(self, last_deleted_id, batch_deleted):
        """æ›´æ–°åˆ é™¤è¿›åº¦"""
        self.cursor.execute("""
            UPDATE delete_job_status 
            SET last_deleted_id = %s,
                deleted_count = deleted_count + %s,
                last_update = NOW()
            WHERE job_id = %s
        """, (last_deleted_id, batch_deleted, self.job_id))
        
        self.connection.commit()
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åˆ†æ‰¹åˆ é™¤æœ¬è´¨ï¼šå°†å¤§ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡ï¼Œé™ä½ç³»ç»Ÿå‹åŠ›
ğŸ”¸ DELETE LIMITï¼šæ§åˆ¶å•æ¬¡åˆ é™¤æ•°é‡çš„æ ¸å¿ƒè¯­æ³•
ğŸ”¸ ORDER BYé‡è¦æ€§ï¼šä¿è¯åˆ é™¤é¡ºåºï¼Œåˆ©ç”¨ç´¢å¼•ä¼˜åŒ–
ğŸ”¸ äº‹åŠ¡å¤§å°æ§åˆ¶ï¼šå¹³è¡¡æ•ˆç‡ä¸ç¨³å®šæ€§
ğŸ”¸ è¿›åº¦ç›‘æ§ï¼šå®æ—¶è·Ÿè¸ªåˆ é™¤è¿›åº¦ï¼Œæ”¯æŒä¸­æ–­æ¢å¤
ğŸ”¸ ç´¢å¼•ç­–ç•¥ï¼šä¸ºåˆ é™¤æ“ä½œè®¾è®¡ä¸“é—¨çš„ç´¢å¼•
```

### 7.2 å…³é”®å‚æ•°é…ç½®æŒ‡å—


**ğŸ¯ æ‰¹æ¬¡å¤§å°é€‰æ‹©**
```
å°è¡¨ï¼ˆ<10ä¸‡è®°å½•ï¼‰ï¼š500-1000æ¡/æ‰¹
ä¸­è¡¨ï¼ˆ10ä¸‡-100ä¸‡ï¼‰ï¼š1000-3000æ¡/æ‰¹  
å¤§è¡¨ï¼ˆ100ä¸‡-1000ä¸‡ï¼‰ï¼š2000-5000æ¡/æ‰¹
è¶…å¤§è¡¨ï¼ˆ1000ä¸‡+ï¼‰ï¼š3000-5000æ¡/æ‰¹

è°ƒæ•´åŸåˆ™ï¼š
â€¢ å•æ‰¹æ‰§è¡Œæ—¶é—´ï¼š1-3ç§’
â€¢ é”ç­‰å¾…æ—¶é—´ï¼š<5ç§’
â€¢ å†…å­˜å ç”¨ï¼š<100MB/æ‰¹
```

**â° æš‚åœæ—¶é—´è®¾ç½®**
```
é«˜å³°æœŸï¼š0.5-1.0ç§’  ï¼ˆå‡å°‘ä¸šåŠ¡å½±å“ï¼‰
å¹³å³°æœŸï¼š0.1-0.3ç§’  ï¼ˆæé«˜åˆ é™¤æ•ˆç‡ï¼‰
ä½å³°æœŸï¼š0.05-0.1ç§’ ï¼ˆæœ€å¤§åŒ–åˆ é™¤é€Ÿåº¦ï¼‰

æ™ºèƒ½è°ƒæ•´ï¼š
æ ¹æ®CPUã€å†…å­˜ä½¿ç”¨ç‡åŠ¨æ€è°ƒæ•´
```

### 7.3 å®é™…åº”ç”¨æœ€ä½³å®è·µ


**ğŸ› ï¸ åˆ é™¤å‰å‡†å¤‡æ¸…å•**
- [ ] **è¯„ä¼°æ•°æ®é‡**ï¼šç¡®è®¤è¦åˆ é™¤çš„è®°å½•æ•°
- [ ] **æ£€æŸ¥ç´¢å¼•**ï¼šç¡®ä¿åˆ é™¤æ¡ä»¶æœ‰åˆé€‚ç´¢å¼•
- [ ] **é€‰æ‹©æ—¶æœº**ï¼šåœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ
- [ ] **å¤‡ä»½æ•°æ®**ï¼šé‡è¦æ•°æ®åˆ é™¤å‰å¤‡ä»½
- [ ] **æµ‹è¯•è„šæœ¬**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åˆ é™¤é€»è¾‘

**âš¡ åˆ é™¤è¿‡ç¨‹ç›‘æ§**
- [ ] **è¿›åº¦è·Ÿè¸ª**ï¼šå®æ—¶æ˜¾ç¤ºåˆ é™¤è¿›åº¦
- [ ] **æ€§èƒ½ç›‘æ§**ï¼šCPUã€å†…å­˜ã€ç£ç›˜IO
- [ ] **é”ç­‰å¾…ç›‘æ§**ï¼šæ£€æŸ¥æ˜¯å¦å½±å“å…¶ä»–æ“ä½œ
- [ ] **é”™è¯¯å¤„ç†**ï¼šå¼‚å¸¸æƒ…å†µçš„å¤„ç†é¢„æ¡ˆ

**âœ… åˆ é™¤åéªŒè¯**
- [ ] **æ•°æ®éªŒè¯**ï¼šç¡®è®¤åˆ é™¤ç»“æœç¬¦åˆé¢„æœŸ
- [ ] **æ€§èƒ½æ¢å¤**ï¼šç¡®è®¤ç³»ç»Ÿæ€§èƒ½æ¢å¤æ­£å¸¸
- [ ] **ç©ºé—´å›æ”¶**ï¼šæ‰§è¡ŒOPTIMIZE TABLEå›æ”¶ç©ºé—´
- [ ] **ç»Ÿè®¡æ›´æ–°**ï¼šæ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯

### 7.4 å¸¸è§è¯¯åŒºä¸æ³¨æ„äº‹é¡¹


**â— å¸¸è§è¯¯åŒº**
```
è¯¯åŒº1ï¼šè®¤ä¸ºLIMITå°±å¤Ÿäº†
âœ… æ­£ç¡®ï¼šå¿…é¡»é…åˆORDER BYå’Œåˆé€‚çš„ç´¢å¼•

è¯¯åŒº2ï¼šæ‰¹æ¬¡è¶Šå°è¶Šå®‰å…¨
âœ… æ­£ç¡®ï¼šæ‰¹æ¬¡å¤ªå°æ•ˆç‡ä½ï¼Œè¦æ‰¾åˆ°å¹³è¡¡ç‚¹

è¯¯åŒº3ï¼šåˆ é™¤å®Œå°±ç»“æŸäº†
âœ… æ­£ç¡®ï¼šéœ€è¦éªŒè¯ç»“æœã€å›æ”¶ç©ºé—´ã€æ›´æ–°ç»Ÿè®¡

è¯¯åŒº4ï¼šä¸€ä¸ªè„šæœ¬è§£å†³æ‰€æœ‰åœºæ™¯
âœ… æ­£ç¡®ï¼šä¸åŒè¡¨ã€ä¸åŒæ•°æ®é‡éœ€è¦ä¸åŒç­–ç•¥
```

**ğŸš¨ å…³é”®æ³¨æ„äº‹é¡¹**
> âš ï¸ **æ•°æ®å®‰å…¨**ï¼šé‡è¦æ•°æ®åˆ é™¤å‰ä¸€å®šè¦å¤‡ä»½
> 
> âš ï¸ **ä¸šåŠ¡å½±å“**ï¼šåœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œï¼Œé¿å…å½±å“ç”¨æˆ·
> 
> âš ï¸ **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®ç›‘æ§ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸æƒ…å†µ
> 
> âš ï¸ **å›æ»šé¢„æ¡ˆ**ï¼šå‡†å¤‡åˆ é™¤å¤±è´¥çš„å›æ»šæ–¹æ¡ˆ

### 7.5 æŠ€æœ¯é€‰å‹å»ºè®®


**ğŸ”§ å·¥å…·é€‰æ‹©æŒ‡å—**
```
å­˜å‚¨è¿‡ç¨‹æ–¹æ¡ˆï¼š
âœ… é€‚åˆï¼šMySQLç¯å¢ƒï¼Œåˆ é™¤é€»è¾‘ç®€å•
âœ… ä¼˜åŠ¿ï¼šæ‰§è¡Œæ•ˆç‡é«˜ï¼Œç½‘ç»œå¼€é”€å°
âŒ åŠ£åŠ¿ï¼šè°ƒè¯•å›°éš¾ï¼Œè·¨æ•°æ®åº“ç§»æ¤æ€§å·®

Python/Javaè„šæœ¬ï¼š
âœ… é€‚åˆï¼šå¤æ‚åˆ é™¤é€»è¾‘ï¼Œéœ€è¦å¤–éƒ¨ç³»ç»Ÿé›†æˆ
âœ… ä¼˜åŠ¿ï¼šçµæ´»æ€§é«˜ï¼Œæ˜“äºè°ƒè¯•å’Œç›‘æ§
âŒ åŠ£åŠ¿ï¼šç½‘ç»œå¼€é”€å¤§ï¼Œéœ€è¦é¢å¤–è¿è¡Œç¯å¢ƒ

æ‰¹å¤„ç†å·¥å…·ï¼ˆå¦‚ETLï¼‰ï¼š
âœ… é€‚åˆï¼šå¤§è§„æ¨¡æ•°æ®æ¸…ç†ï¼Œå®šæœŸæ‰§è¡Œ
âœ… ä¼˜åŠ¿ï¼šä¼ä¸šçº§ç‰¹æ€§ï¼Œå¯è§†åŒ–ç›‘æ§
âŒ åŠ£åŠ¿ï¼šå­¦ä¹ æˆæœ¬é«˜ï¼Œå¯èƒ½éœ€è¦é¢å¤–è®¸å¯
```

**ğŸ’¡ é€‰æ‹©å†³ç­–æ ‘**
```
æ•°æ®é‡ < 100ä¸‡ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ç›´æ¥åˆ é™¤æˆ–ç®€å•åˆ†æ‰¹
â””â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­

ä¸šåŠ¡å½±å“æ•æ„Ÿï¼Ÿ
â”œâ”€ æ˜¯ â†’ Pythonè„šæœ¬ + æ™ºèƒ½æš‚åœ
â””â”€ å¦ â†’ å­˜å‚¨è¿‡ç¨‹ + å›ºå®šæ‰¹æ¬¡

åˆ é™¤é€»è¾‘å¤æ‚ï¼Ÿ
â”œâ”€ æ˜¯ â†’ åº”ç”¨ç¨‹åºå®ç°
â””â”€ å¦ â†’ æ•°æ®åº“å­˜å‚¨è¿‡ç¨‹

å®šæœŸæ‰§è¡Œï¼Ÿ
â”œâ”€ æ˜¯ â†’ ETLå·¥å…· + è°ƒåº¦ç³»ç»Ÿ
â””â”€ å¦ â†’ ä¸€æ¬¡æ€§è„šæœ¬
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
```
å¤§æ‰¹é‡åˆ é™¤ = åŒ–æ•´ä¸ºé›¶çš„è‰ºæœ¯
å…³é”®åŸåˆ™ï¼šå°æ‰¹æ¬¡ + æ§åˆ¶èŠ‚å¥ + æŒç»­ç›‘æ§
æ ¸å¿ƒç›®æ ‡ï¼šåˆ é™¤æ•°æ®çš„åŒæ—¶ä¸å½±å“ä¸šåŠ¡è¿è¡Œ
æŠ€æœ¯æ‰‹æ®µï¼šLIMITåˆ†é¡µ + ORDER BYæ’åº + æ™ºèƒ½æš‚åœ
```

**ğŸ”‘ å¿…å¤‡æŠ€èƒ½æ¸…å•**
- ğŸ¯ ç†è§£å¤§æ‰¹é‡åˆ é™¤çš„æ€§èƒ½å½±å“æœºåˆ¶
- ğŸ”§ æŒæ¡DELETE LIMITçš„æ­£ç¡®ä½¿ç”¨æ–¹æ³•  
- ğŸ“Š èƒ½å¤Ÿè®¾è®¡åˆé€‚çš„æ‰¹æ¬¡å¤§å°å’Œæš‚åœç­–ç•¥
- ğŸ’¾ å®ç°åˆ é™¤è¿›åº¦çš„ç›‘æ§å’Œæ¢å¤æœºåˆ¶
- ğŸ—ƒï¸ é’ˆå¯¹å¤§è¡¨åˆ¶å®šä¸“é—¨çš„åˆ é™¤ä¼˜åŒ–æ–¹æ¡ˆ