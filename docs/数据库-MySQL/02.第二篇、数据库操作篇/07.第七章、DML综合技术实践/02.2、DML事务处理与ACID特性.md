---
title: 2ã€DMLäº‹åŠ¡å¤„ç†ä¸ACIDç‰¹æ€§
---
## ğŸ“š ç›®å½•

1. [äº‹åŠ¡åŸºç¡€æ¦‚å¿µä¸DMLå…³ç³»](#1-äº‹åŠ¡åŸºç¡€æ¦‚å¿µä¸dmlå…³ç³»)
2. [ACIDç‰¹æ€§æ·±åº¦è§£æ](#2-acidç‰¹æ€§æ·±åº¦è§£æ)
3. [äº‹åŠ¡éš”ç¦»çº§åˆ«å¯¹DMLå½±å“](#3-äº‹åŠ¡éš”ç¦»çº§åˆ«å¯¹dmlå½±å“)
4. [é•¿äº‹åŠ¡é£é™©ä¸æ§åˆ¶ç­–ç•¥](#4-é•¿äº‹åŠ¡é£é™©ä¸æ§åˆ¶ç­–ç•¥)
5. [åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æœºåˆ¶](#5-åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æœºåˆ¶)
6. [äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](#6-äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ äº‹åŠ¡åŸºç¡€æ¦‚å¿µä¸DMLå…³ç³»


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
äº‹åŠ¡(Transaction)ï¼šæ•°æ®åº“æ“ä½œçš„åŸºæœ¬æ‰§è¡Œå•ä½
æœ¬è´¨ï¼šå°†å¤šä¸ªDMLæ“ä½œæ‰“åŒ…æˆä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“
ç›®æ ‡ï¼šä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§
```

**ğŸ’¡ é€šä¿—ç†è§£ï¼šäº‹åŠ¡å°±åƒç”Ÿæ´»ä¸­çš„"æ‰“åŒ…äº¤æ˜“"**
```
ç°å®ä¾‹å­ï¼šç½‘ä¸Šè´­ç‰©
â”œâ”€â”€ æ­¥éª¤1ï¼šæ‰£é™¤è´¦æˆ·ä½™é¢
â”œâ”€â”€ æ­¥éª¤2ï¼šå‡å°‘å•†å“åº“å­˜  
â”œâ”€â”€ æ­¥éª¤3ï¼šç”Ÿæˆè®¢å•è®°å½•
â””â”€â”€ æ­¥éª¤4ï¼šå‘é€ç¡®è®¤çŸ­ä¿¡

è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å–æ¶ˆ
ä¸èƒ½å‡ºç°"é’±æ‰£äº†ä½†æ²¡æœ‰å•†å“"çš„æƒ…å†µ
```

### 1.2 DMLæ“ä½œä¸äº‹åŠ¡çš„å…³ç³»


**ğŸ”¸ DMLæ“ä½œçš„äº‹åŠ¡ç‰¹æ€§**

| DMLç±»å‹ | **äº‹åŠ¡è¡Œä¸º** | **å½±å“èŒƒå›´** | **å›æ»šèƒ½åŠ›** |
|---------|-------------|-------------|-------------|
| ğŸ”„ **INSERT** | `è‡ªåŠ¨å¼€å¯äº‹åŠ¡` | `æ–°å¢æ•°æ®è¡Œ` | `âœ… å¯å®Œå…¨å›æ»š` |
| ğŸ“ **UPDATE** | `ä¿®æ”¹å·²æœ‰äº‹åŠ¡` | `æ›´æ–°ç°æœ‰æ•°æ®` | `âœ… å¯æ¢å¤åŸå€¼` |
| ğŸ—‘ï¸ **DELETE** | `åˆ é™¤æ“ä½œäº‹åŠ¡` | `ç§»é™¤æ•°æ®è¡Œ` | `âœ… å¯æ¢å¤åˆ é™¤æ•°æ®` |

**âš¡ äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ**
```sql
-- äº‹åŠ¡çš„åŸºæœ¬ç”Ÿå‘½å‘¨æœŸ
START TRANSACTION;        -- å¼€å§‹äº‹åŠ¡ ğŸš€
  INSERT INTO users ...;  -- DMLæ“ä½œ1
  UPDATE orders ...;      -- DMLæ“ä½œ2  
  DELETE FROM temp ...;   -- DMLæ“ä½œ3
COMMIT;                   -- æäº¤äº‹åŠ¡ âœ…

-- æˆ–è€…å›æ»šäº‹åŠ¡
START TRANSACTION;
  INSERT INTO users ...;
  -- å‘ç°é—®é¢˜ï¼Œå–æ¶ˆæ‰€æœ‰æ“ä½œ
ROLLBACK;                 -- å›æ»šäº‹åŠ¡ âŒ
```

### 1.3 ä¸ºä»€ä¹ˆDMLéœ€è¦äº‹åŠ¡ä¿æŠ¤


**ğŸ›¡ï¸ æ•°æ®ä¸€è‡´æ€§ä¿éšœ**
```
é“¶è¡Œè½¬è´¦ä¾‹å­ï¼š
è´¦æˆ·Aï¼šä½™é¢1000å…ƒ
è´¦æˆ·Bï¼šä½™é¢500å…ƒ

è½¬è´¦æ“ä½œï¼ˆAè½¬ç»™B 200å…ƒï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UPDATE account              â”‚
â”‚ SET balance = balance - 200 â”‚  â† DMLæ“ä½œ1
â”‚ WHERE account_id = 'A';     â”‚
â”‚                             â”‚
â”‚ UPDATE account              â”‚
â”‚ SET balance = balance + 200 â”‚  â† DMLæ“ä½œ2  
â”‚ WHERE account_id = 'B';     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ²¡æœ‰äº‹åŠ¡ä¿æŠ¤çš„é£é™©ï¼š
âŒ æ“ä½œ1æˆåŠŸï¼Œæ“ä½œ2å¤±è´¥ â†’ Aå°‘äº†200ï¼ŒBæ²¡å¢åŠ 
âŒ ç³»ç»Ÿå´©æºƒåœ¨ä¸¤æ“ä½œä¹‹é—´ â†’ é’±å‡­ç©ºæ¶ˆå¤±
âŒ å¹¶å‘æ“ä½œå¹²æ‰° â†’ æ•°æ®çŠ¶æ€æ··ä¹±
```

---

## 2. ğŸ›ï¸ ACIDç‰¹æ€§æ·±åº¦è§£æ


### 2.1 ACIDç‰¹æ€§æ¦‚è¿°


**ğŸ”¸ ACIDå››å¤§ç‰¹æ€§**
```
A - Atomicityï¼ˆåŸå­æ€§ï¼‰   â† è¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš
C - Consistencyï¼ˆä¸€è‡´æ€§ï¼‰  â† æ•°æ®å§‹ç»ˆä¿æŒåˆæ³•çŠ¶æ€  
I - Isolationï¼ˆéš”ç¦»æ€§ï¼‰   â† å¹¶å‘äº‹åŠ¡äº’ä¸å¹²æ‰°
D - Durabilityï¼ˆæŒä¹…æ€§ï¼‰   â† æäº¤åæ°¸ä¹…ä¿å­˜
```

**ğŸ“Š ACIDç‰¹æ€§å…³ç³»å›¾**
```
ä¸šåŠ¡éœ€æ±‚
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ACIDç‰¹æ€§ä¿éšœ              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚åŸå­æ€§(A)â”‚ â”‚ä¸€è‡´æ€§(C)â”‚ â”‚éš”ç¦»æ€§(I)â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚         æŒä¹…æ€§(D)               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
å¯é çš„æ•°æ®å­˜å‚¨
```

### 2.2 åŸå­æ€§ï¼ˆAtomicityï¼‰è¯¦è§£ â­â­â­


**ğŸ”¸ åŸå­æ€§çš„æœ¬è´¨å«ä¹‰**
```
åŸå­æ€§ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½
é€šä¿—ç†è§£ï¼šå°±åƒä¹°ä¸œè¥¿"ä¸€æ‰‹äº¤é’±ä¸€æ‰‹äº¤è´§"
è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼šæ‰€æœ‰DMLæ“ä½œéƒ½æ‰§è¡ŒæˆåŠŸ
è¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼šä»»ä½•ä¸€ä¸ªæ“ä½œå¤±è´¥ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ’¤é”€
```

**ğŸ’¡ åŸå­æ€§å®ç°æœºåˆ¶**
```
MySQLå®ç°åŸå­æ€§çš„æ–¹å¼ï¼š

äº‹åŠ¡æ—¥å¿—ï¼ˆTransaction Logï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡ŒDMLæ“ä½œ    â”‚    â”‚   è®°å½•å˜æ›´æ—¥å¿—   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚INSERT...    â”‚ â”‚â”€â”€â”€â”€â†’ â”‚Log: INSERT  â”‚ â”‚
â”‚ â”‚UPDATE...    â”‚ â”‚â”€â”€â”€â”€â†’ â”‚Log: UPDATE  â”‚ â”‚
â”‚ â”‚DELETE...    â”‚ â”‚â”€â”€â”€â”€â†’ â”‚Log: DELETE  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å›æ»šæœºåˆ¶ï¼š
â€¢ æ“ä½œå¤±è´¥æ—¶ï¼Œæ ¹æ®æ—¥å¿—åå‘æ‰§è¡Œ
â€¢ INSERTçš„å›æ»š â†’ DELETEå¯¹åº”è®°å½•
â€¢ UPDATEçš„å›æ»š â†’ æ¢å¤åŸå§‹å€¼
â€¢ DELETEçš„å›æ»š â†’ é‡æ–°INSERTè®°å½•
```

**ğŸ”§ åŸå­æ€§å®é™…åº”ç”¨ç¤ºä¾‹**
```sql
-- ç”µå•†è®¢å•å¤„ç†äº‹åŠ¡
START TRANSACTION;

-- 1. å‡å°‘å•†å“åº“å­˜
UPDATE products 
SET stock = stock - 1 
WHERE product_id = 'P001' AND stock > 0;

-- 2. åˆ›å»ºè®¢å•è®°å½•
INSERT INTO orders (order_id, user_id, product_id, quantity, amount)
VALUES ('ORD001', 'U123', 'P001', 1, 99.99);

-- 3. è®°å½•åº“å­˜å˜åŠ¨æ—¥å¿—
INSERT INTO stock_logs (product_id, change_type, quantity, operator)
VALUES ('P001', 'SALE', -1, 'SYSTEM');

-- æ£€æŸ¥æ‰€æœ‰æ“ä½œæ˜¯å¦æˆåŠŸ
IF (æ‰€æœ‰æ“ä½œæˆåŠŸ) THEN
    COMMIT;    -- å…¨éƒ¨æäº¤
ELSE
    ROLLBACK;  -- å…¨éƒ¨å›æ»š
END IF;
```

### 2.3 ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰è¯¦è§£ â­â­â­


**ğŸ”¸ ä¸€è‡´æ€§çš„æ·±å±‚å«ä¹‰**
```
ä¸€è‡´æ€§ï¼šæ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€
é€šä¿—ç†è§£ï¼šæ•°æ®å¿…é¡»ç¬¦åˆæ‰€æœ‰çš„ä¸šåŠ¡è§„åˆ™å’Œçº¦æŸ
æ ¸å¿ƒè¦æ±‚ï¼šäº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®éƒ½æ˜¯"åˆæ³•"çš„
```

**ğŸ¯ ä¸€è‡´æ€§çš„ä¸¤ä¸ªå±‚é¢**

```
æ•°æ®åº“å±‚é¢ä¸€è‡´æ€§ï¼š
â”œâ”€â”€ ä¸»é”®çº¦æŸï¼šä¸èƒ½æœ‰é‡å¤çš„ä¸»é”®å€¼
â”œâ”€â”€ å¤–é”®çº¦æŸï¼šå¼•ç”¨çš„è®°å½•å¿…é¡»å­˜åœ¨
â”œâ”€â”€ æ£€æŸ¥çº¦æŸï¼šæ•°æ®å€¼å¿…é¡»æ»¡è¶³æ¡ä»¶
â””â”€â”€ è§¦å‘å™¨ï¼šè‡ªåŠ¨æ‰§è¡Œçš„æ•°æ®éªŒè¯é€»è¾‘

ä¸šåŠ¡å±‚é¢ä¸€è‡´æ€§ï¼š
â”œâ”€â”€ è´¦æˆ·ä½™é¢ï¼šä¸èƒ½ä¸ºè´Ÿæ•°ï¼ˆé™¤éå…è®¸é€æ”¯ï¼‰
â”œâ”€â”€ åº“å­˜æ•°é‡ï¼šä¸èƒ½è¶…å–å•†å“
â”œâ”€â”€ è®¢å•çŠ¶æ€ï¼šå¿…é¡»æŒ‰åˆç†æµç¨‹æµè½¬
â””â”€â”€ æ•°æ®å…³è”ï¼šç›¸å…³æ•°æ®å¿…é¡»ä¿æŒåŒæ­¥
```

**ğŸ’¡ ä¸€è‡´æ€§çº¦æŸå®ä¾‹**
```sql
-- åˆ›å»ºå…·æœ‰ä¸€è‡´æ€§çº¦æŸçš„è¡¨
CREATE TABLE accounts (
    account_id VARCHAR(20) PRIMARY KEY,
    balance DECIMAL(15,2) NOT NULL,
    status ENUM('ACTIVE', 'FROZEN', 'CLOSED') DEFAULT 'ACTIVE',
    
    -- ä¸€è‡´æ€§çº¦æŸï¼šä½™é¢ä¸èƒ½ä¸ºè´Ÿ
    CONSTRAINT chk_balance CHECK (balance >= 0),
    
    -- ä¸šåŠ¡è§„åˆ™ï¼šå†»ç»“è´¦æˆ·ä½™é¢å¿…é¡»ä¸º0
    CONSTRAINT chk_frozen_balance 
    CHECK (status != 'FROZEN' OR balance = 0)
);

-- è¿åä¸€è‡´æ€§çš„æ“ä½œä¼šè¢«æ‹’ç»
UPDATE accounts 
SET balance = -100 
WHERE account_id = 'ACC001';
-- Error: Check constraint 'chk_balance' is violated
```

### 2.4 éš”ç¦»æ€§ï¼ˆIsolationï¼‰è¯¦è§£ â­â­â­


**ğŸ”¸ éš”ç¦»æ€§çš„æ ¸å¿ƒä½œç”¨**
```
éš”ç¦»æ€§ï¼šå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¹‹é—´ä¸èƒ½ç›¸äº’å¹²æ‰°
é€šä¿—ç†è§£ï¼šå°±åƒé“¶è¡Œçª—å£ï¼Œæ¯ä¸ªå®¢æˆ·çš„ä¸šåŠ¡äº’ä¸å½±å“
ç›®æ ‡ï¼šå³ä½¿å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œï¼Œæ•ˆæœä¹Ÿåƒä¸²è¡Œæ‰§è¡Œä¸€æ ·
```

**ğŸ”„ å¹¶å‘é—®é¢˜æ¼”ç¤º**
```
åœºæ™¯ï¼šä¸¤ä¸ªç”¨æˆ·åŒæ—¶æŸ¥çœ‹å¹¶è´­ä¹°å•†å“åº“å­˜

æ—¶é—´çº¿ï¼š
T1æ—¶åˆ»ï¼šç”¨æˆ·AæŸ¥è¯¢åº“å­˜ â†’ æ˜¾ç¤ºæœ‰10ä»¶
T2æ—¶åˆ»ï¼šç”¨æˆ·BæŸ¥è¯¢åº“å­˜ â†’ æ˜¾ç¤ºæœ‰10ä»¶
T3æ—¶åˆ»ï¼šç”¨æˆ·Aè´­ä¹°5ä»¶ â†’ åº“å­˜å˜ä¸º5ä»¶
T4æ—¶åˆ»ï¼šç”¨æˆ·Bè´­ä¹°8ä»¶ â†’ åº“å­˜å˜ä¸º-3ä»¶ï¼Ÿ

é—®é¢˜ï¼šæ²¡æœ‰éš”ç¦»æ€§å¯¼è‡´è¶…å–
è§£å†³ï¼šäº‹åŠ¡éš”ç¦»ç¡®ä¿æ“ä½œçš„ç‹¬ç«‹æ€§
```

**âš™ï¸ éš”ç¦»æ€§å®ç°æœºåˆ¶**
```
é”æœºåˆ¶ï¼ˆLockingï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº‹åŠ¡Aè®¿é—®     â”‚    â”‚   äº‹åŠ¡Bç­‰å¾…     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚è·å–è¡Œé”     â”‚ â”‚    â”‚ â”‚ç­‰å¾…é”é‡Šæ”¾   â”‚ â”‚
â”‚ â”‚æ‰§è¡ŒUPDATE   â”‚ â”‚    â”‚ â”‚æš‚æ—¶é˜»å¡     â”‚ â”‚
â”‚ â”‚é‡Šæ”¾é”       â”‚ â”‚â”€â”€â”€â”€â†’ â”‚è·å–é”ç»§ç»­   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MVCCæœºåˆ¶ï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼š
â€¢ æ¯ä¸ªäº‹åŠ¡çœ‹åˆ°æ•°æ®çš„ç‰¹å®šç‰ˆæœ¬
â€¢ é¿å…è¯»å†™å†²çªï¼Œæé«˜å¹¶å‘æ€§èƒ½
â€¢ InnoDBå­˜å‚¨å¼•æ“çš„æ ¸å¿ƒæŠ€æœ¯
```

### 2.5 æŒä¹…æ€§ï¼ˆDurabilityï¼‰è¯¦è§£ â­â­â­


**ğŸ”¸ æŒä¹…æ€§çš„ä¿éšœæ„ä¹‰**
```
æŒä¹…æ€§ï¼šäº‹åŠ¡æäº¤åï¼Œæ•°æ®å˜æ›´æ°¸ä¹…ä¿å­˜
é€šä¿—ç†è§£ï¼šå°±åƒåœ¨çº¸ä¸Šç­¾å­—ï¼ŒåˆåŒç”Ÿæ•ˆåä¸èƒ½åæ‚”
ä¿éšœï¼šå³ä½¿ç³»ç»Ÿæ•…éšœã€æ–­ç”µï¼Œå·²æäº¤çš„æ•°æ®ä¸ä¼šä¸¢å¤±
```

**ğŸ’¾ æŒä¹…æ€§å®ç°æŠ€æœ¯**
```
é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰ï¼š
ä½œç”¨ï¼šè®°å½•æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹
æµç¨‹ï¼šå…ˆå†™æ—¥å¿—ï¼Œå†ä¿®æ”¹æ•°æ®é¡µ
ä¼˜åŠ¿ï¼šé¡ºåºå†™å…¥æ¯”éšæœºå†™å…¥å¿«å¾—å¤š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DMLæ“ä½œæ‰§è¡Œ  â”‚â”€â”€â”€â”€â†’â”‚å†™å…¥Redo Log â”‚â”€â”€â”€â”€â†’â”‚ä¿®æ”¹æ•°æ®é¡µ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     å¿«é€Ÿ             æŒä¹…åŒ–             å¯èƒ½å»¶è¿Ÿ

å´©æºƒæ¢å¤ï¼š
â€¢ ç³»ç»Ÿé‡å¯æ—¶è¯»å–Redo Log
â€¢ é‡æ–°æ‰§è¡Œå·²æäº¤ä½†æœªå†™å…¥ç£ç›˜çš„æ“ä½œ
â€¢ ç¡®ä¿å·²æäº¤æ•°æ®ä¸ä¼šä¸¢å¤±
```

**ğŸ”§ æŒä¹…æ€§é…ç½®å‚æ•°**
```sql
-- æ§åˆ¶æŒä¹…æ€§çš„å…³é”®å‚æ•°
SET innodb_flush_log_at_trx_commit = 1;
/*
å€¼è¯´æ˜ï¼š
0ï¼šæ¯ç§’åˆ·æ–°ä¸€æ¬¡æ—¥å¿—åˆ°ç£ç›˜ï¼ˆæ€§èƒ½æœ€å¥½ï¼ŒæŒä¹…æ€§æœ€å·®ï¼‰
1ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½åˆ·æ–°ï¼ˆæŒä¹…æ€§æœ€å¥½ï¼Œæ€§èƒ½è¾ƒå·®ï¼‰
2ï¼šæ¯æ¬¡æäº¤å†™åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆå¹³è¡¡æ–¹æ¡ˆï¼‰

é€‰æ‹©åŸåˆ™ï¼š
é‡‘èç³»ç»Ÿï¼šå¿…é¡»è®¾ä¸º1ï¼Œä¿è¯ç»å¯¹æŒä¹…æ€§
ä¸€èˆ¬Webåº”ç”¨ï¼šå¯è®¾ä¸º2ï¼Œå¹³è¡¡æ€§èƒ½å’Œå®‰å…¨æ€§
æ—¥å¿—ç³»ç»Ÿï¼šå¯è®¾ä¸º0ï¼Œå…è®¸å°‘é‡æ•°æ®ä¸¢å¤±
*/
```

---

## 3. ğŸ”’ äº‹åŠ¡éš”ç¦»çº§åˆ«å¯¹DMLå½±å“


### 3.1 å››ç§éš”ç¦»çº§åˆ«æ¦‚è¿°


**ğŸ“Š éš”ç¦»çº§åˆ«å¯¹æ¯”è¡¨**

| éš”ç¦»çº§åˆ« | **è„è¯»** | **ä¸å¯é‡å¤è¯»** | **å¹»è¯»** | **æ€§èƒ½** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------------|---------|---------|-------------|
| ğŸ”“ **READ UNCOMMITTED** | `âŒ å¯èƒ½` | `âŒ å¯èƒ½` | `âŒ å¯èƒ½` | `â­â­â­â­â­` | `æ—¥å¿—åˆ†æã€ä¸´æ—¶ç»Ÿè®¡` |
| ğŸ“– **READ COMMITTED** | `âœ… é¿å…` | `âŒ å¯èƒ½` | `âŒ å¯èƒ½` | `â­â­â­â­` | `å¤§éƒ¨åˆ†Webåº”ç”¨` |
| ğŸ”„ **REPEATABLE READ** | `âœ… é¿å…` | `âœ… é¿å…` | `âŒ å¯èƒ½` | `â­â­â­` | `MySQLé»˜è®¤çº§åˆ«` |
| ğŸ” **SERIALIZABLE** | `âœ… é¿å…` | `âœ… é¿å…` | `âœ… é¿å…` | `â­` | `é‡‘èæ ¸å¿ƒç³»ç»Ÿ` |

### 3.2 éš”ç¦»çº§åˆ«é—®é¢˜è¯¦è§£


#### ğŸš« è„è¯»ï¼ˆDirty Readï¼‰é—®é¢˜


**ğŸ”¸ ä»€ä¹ˆæ˜¯è„è¯»**
```
è„è¯»ï¼šè¯»å–åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®
å±å®³ï¼šè¯»åˆ°çš„æ•°æ®å¯èƒ½æ˜¯é”™è¯¯çš„ã€ä¸´æ—¶çš„
```

**ğŸ’¡ è„è¯»é—®é¢˜æ¼”ç¤º**
```
æ—¶é—´è½´æ¼”ç¤ºï¼š
T1: äº‹åŠ¡Aå¼€å§‹
T2: äº‹åŠ¡Aæ‰§è¡Œ UPDATE users SET balance = 1000 WHERE id = 1
T3: äº‹åŠ¡Bè¯»å– SELECT balance FROM users WHERE id = 1  â† è¯»åˆ°1000
T4: äº‹åŠ¡Aå›æ»š ROLLBACK  â† balanceå®é™…è¿˜æ˜¯åŸæ¥çš„å€¼
T5: äº‹åŠ¡BåŸºäºé”™è¯¯æ•°æ®ç»§ç»­å¤„ç† â† é—®é¢˜äº§ç”Ÿï¼

é—®é¢˜åˆ†æï¼š
äº‹åŠ¡Bè¯»åˆ°äº†äº‹åŠ¡Aæœªæäº¤çš„æ•°æ®ï¼ˆ1000ï¼‰
äº‹åŠ¡Aæœ€ç»ˆå›æ»šï¼Œå®é™…balanceæ²¡æœ‰å˜åŒ–
äº‹åŠ¡BåŸºäºé”™è¯¯æ•°æ®åšå†³ç­–ï¼Œå¯¼è‡´ä¸šåŠ¡é”™è¯¯
```

#### ğŸ”„ ä¸å¯é‡å¤è¯»ï¼ˆNon-Repeatable Readï¼‰


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä¸å¯é‡å¤è¯»**
```
ä¸å¯é‡å¤è¯»ï¼šåŒä¸€äº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œç»“æœä¸ä¸€è‡´
åŸå› ï¼šå…¶ä»–äº‹åŠ¡åœ¨è¯»å–é—´éš™ä¿®æ”¹äº†æ•°æ®
å½±å“ï¼šäº‹åŠ¡å†…éƒ¨é€»è¾‘å¯èƒ½å‡ºç°çŸ›ç›¾
```

**ğŸ“ˆ ä¸å¯é‡å¤è¯»ç¤ºä¾‹**
```sql
-- äº‹åŠ¡Açš„æ‰§è¡Œè¿‡ç¨‹
START TRANSACTION;
SELECT balance FROM accounts WHERE id = 'A001';  -- ç¬¬ä¸€æ¬¡è¯»å–ï¼š1000

-- æ­¤æ—¶äº‹åŠ¡Bæ‰§è¡Œäº†ï¼š
-- UPDATE accounts SET balance = 800 WHERE id = 'A001';
-- COMMIT;

SELECT balance FROM accounts WHERE id = 'A001';  -- ç¬¬äºŒæ¬¡è¯»å–ï¼š800
COMMIT;

é—®é¢˜ï¼šåŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œä¸¤æ¬¡è¯»å–ç»“æœä¸åŒ
å½±å“ï¼šå¦‚æœåŸºäºç¬¬ä¸€æ¬¡è¯»å–ç»“æœåšè®¡ç®—ï¼Œå¯èƒ½å‡ºé”™
```

#### ğŸ‘» å¹»è¯»ï¼ˆPhantom Readï¼‰


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¹»è¯»**
```
å¹»è¯»ï¼šåŒä¸€äº‹åŠ¡å†…å¤šæ¬¡æ‰§è¡Œç›¸åŒæŸ¥è¯¢ï¼Œè¿”å›çš„è®°å½•æ•°ä¸åŒ
åŸå› ï¼šå…¶ä»–äº‹åŠ¡æ’å…¥æˆ–åˆ é™¤äº†ç¬¦åˆæ¡ä»¶çš„è®°å½•
ç‰¹ç‚¹ï¼šå½±å“çš„æ˜¯ç»“æœé›†çš„æ•°é‡ï¼Œä¸æ˜¯å•æ¡è®°å½•çš„å€¼
```

**ğŸ”® å¹»è¯»åœºæ™¯æ¼”ç¤º**
```sql
-- äº‹åŠ¡Aï¼šç»Ÿè®¡è®¢å•æ•°é‡
START TRANSACTION;
SELECT COUNT(*) FROM orders WHERE date = '2025-09-02';  -- ç¬¬ä¸€æ¬¡ï¼š100æ¡

-- æ­¤æ—¶äº‹åŠ¡Bæ’å…¥æ–°è®¢å•ï¼š
-- INSERT INTO orders (order_id, date, amount) VALUES ('ORD001', '2025-09-02', 199.99);
-- COMMIT;

SELECT COUNT(*) FROM orders WHERE date = '2025-09-02';  -- ç¬¬äºŒæ¬¡ï¼š101æ¡
COMMIT;

é—®é¢˜ï¼šåŒä¸€æŸ¥è¯¢æ¡ä»¶ï¼Œè®°å½•æ•°é‡å‘ç”Ÿäº†å˜åŒ–
å½±å“ï¼šç»Ÿè®¡æŠ¥è¡¨ã€åˆ†é¡µæŸ¥è¯¢å¯èƒ½å‡ºç°ä¸ä¸€è‡´
```

### 3.3 éš”ç¦»çº§åˆ«çš„é€‰æ‹©ç­–ç•¥


**ğŸ¯ ä¸åŒä¸šåŠ¡åœºæ™¯çš„éš”ç¦»çº§åˆ«é€‰æ‹©**

```
é‡‘èæ”¯ä»˜ç³»ç»Ÿï¼š
æ¨èï¼šSERIALIZABLE
ç†ç”±ï¼šæ•°æ®å‡†ç¡®æ€§è¦æ±‚æé«˜ï¼Œæ€§èƒ½å¯ä»¥é€‚å½“ç‰ºç‰²
é£é™©æ§åˆ¶ï¼šä»»ä½•æ•°æ®ä¸ä¸€è‡´éƒ½å¯èƒ½é€ æˆèµ„é‡‘æŸå¤±

ç”µå•†ç½‘ç«™ï¼š
æ¨èï¼šREAD COMMITTED  
ç†ç”±ï¼šå¹³è¡¡æ€§èƒ½å’Œä¸€è‡´æ€§ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯
ç‰¹æ®Šå¤„ç†ï¼šåº“å­˜æ‰£å‡ä½¿ç”¨æ‚²è§‚é”ä¿æŠ¤

å†…å®¹ç®¡ç†ç³»ç»Ÿï¼š
æ¨èï¼šREPEATABLE READï¼ˆMySQLé»˜è®¤ï¼‰
ç†ç”±ï¼šè¯»æ“ä½œå¤šï¼Œéœ€è¦ä¿è¯è¯»å–ä¸€è‡´æ€§
æ€§èƒ½ï¼šä¸­ç­‰å¹¶å‘ä¸‹æ€§èƒ½è¡¨ç°è‰¯å¥½

æ•°æ®åˆ†æç³»ç»Ÿï¼š
æ¨èï¼šREAD UNCOMMITTED
ç†ç”±ï¼šå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ï¼Œè¿½æ±‚æŸ¥è¯¢æ€§èƒ½
æ³¨æ„ï¼šä»…é€‚ç”¨äºç»Ÿè®¡åˆ†æï¼Œä¸å½±å“ä¸šåŠ¡å†³ç­–
```

---

## 4. â° é•¿äº‹åŠ¡é£é™©ä¸æ§åˆ¶ç­–ç•¥


### 4.1 ä»€ä¹ˆæ˜¯é•¿äº‹åŠ¡


**ğŸ”¸ é•¿äº‹åŠ¡å®šä¹‰**
```
é•¿äº‹åŠ¡ï¼šæ‰§è¡Œæ—¶é—´è¶…è¿‡åˆç†èŒƒå›´çš„äº‹åŠ¡
æ—¶é—´æ ‡å‡†ï¼š
â€¢ ä¸€èˆ¬åº”ç”¨ï¼š> 30ç§’ç®—é•¿äº‹åŠ¡
â€¢ é«˜å¹¶å‘åº”ç”¨ï¼š> 5ç§’ç®—é•¿äº‹åŠ¡  
â€¢ å®æ—¶ç³»ç»Ÿï¼š> 1ç§’ç®—é•¿äº‹åŠ¡

äº§ç”ŸåŸå› ï¼š
â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼šåŒ…å«å¤§é‡DMLæ“ä½œ
â”œâ”€â”€ æ•°æ®é‡åºå¤§ï¼šå¤„ç†ç™¾ä¸‡çº§è®°å½•
â”œâ”€â”€ ç¨‹åºé”™è¯¯ï¼šå¿˜è®°æäº¤æˆ–å›æ»š
â””â”€â”€ é”ç­‰å¾…ï¼šè¢«å…¶ä»–äº‹åŠ¡é˜»å¡
```

### 4.2 é•¿äº‹åŠ¡çš„å±å®³å½±å“


**âš ï¸ é•¿äº‹åŠ¡é£é™©åˆ†æ**

```
æ€§èƒ½å½±å“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          é•¿äº‹åŠ¡å±å®³             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚å ç”¨é”èµ„æºâ”‚  â”‚é˜»å¡å…¶ä»–äº‹åŠ¡ â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  
â”‚ â”‚å†…å­˜æ¶ˆè€— â”‚  â”‚æ—¥å¿—ç©ºé—´å¢é•¿ â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚     ä¸»ä»å¤åˆ¶å»¶è¿ŸåŠ å‰§       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…·ä½“å±å®³ï¼š
ğŸ”¸ é”ç«äº‰åŠ å‰§ï¼šå…¶ä»–äº‹åŠ¡ç­‰å¾…æ—¶é—´å¢é•¿
ğŸ”¸ å†…å­˜å ç”¨å¢åŠ ï¼šå›æ»šæ®µå’Œç¼“å†²æ± å‹åŠ›å¢å¤§  
ğŸ”¸ å¤åˆ¶å»¶è¿Ÿï¼šä»åº“åŒæ­¥è¿›åº¦è½åä¸»åº“
ğŸ”¸ å¤‡ä»½å½±å“ï¼šåœ¨çº¿å¤‡ä»½æ—¶é—´å»¶é•¿
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šè§¦å‘å„ç§æ€§èƒ½å‘Šè­¦
```

### 4.3 é•¿äº‹åŠ¡è¯†åˆ«ä¸ç›‘æ§


**ğŸ” é•¿äº‹åŠ¡ç›‘æ§SQL**
```sql
-- æŸ¥æ‰¾å½“å‰è¿è¡Œçš„é•¿äº‹åŠ¡
SELECT 
    t.trx_id,
    t.trx_started,
    TIMESTAMPDIFF(SECOND, t.trx_started, NOW()) AS duration_seconds,
    p.USER,
    p.HOST,
    p.DB,
    p.COMMAND,
    p.INFO AS current_sql
FROM 
    information_schema.INNODB_TRX t
    LEFT JOIN information_schema.PROCESSLIST p ON t.trx_mysql_thread_id = p.ID
WHERE 
    TIMESTAMPDIFF(SECOND, t.trx_started, NOW()) > 30  -- è¶…è¿‡30ç§’çš„äº‹åŠ¡
ORDER BY duration_seconds DESC;

-- æŸ¥çœ‹äº‹åŠ¡é”ç­‰å¾…æƒ…å†µ
SELECT 
    waiting.trx_id AS waiting_trx,
    waiting.trx_mysql_thread_id AS waiting_thread,
    waiting.trx_query AS waiting_query,
    blocking.trx_id AS blocking_trx,
    blocking.trx_mysql_thread_id AS blocking_thread
FROM 
    information_schema.INNODB_LOCK_WAITS w
    INNER JOIN information_schema.INNODB_TRX waiting ON w.requesting_trx_id = waiting.trx_id
    INNER JOIN information_schema.INNODB_TRX blocking ON w.blocking_trx_id = blocking.trx_id;
```

### 4.4 é•¿äº‹åŠ¡æ§åˆ¶ç­–ç•¥


**ğŸ›¡ï¸ é¢„é˜²å’Œæ§åˆ¶æªæ–½**

```
åº”ç”¨å±‚é¢æ§åˆ¶ï¼š
â”œâ”€â”€ äº‹åŠ¡æ‹†åˆ†ï¼šå°†å¤§äº‹åŠ¡åˆ†è§£ä¸ºå¤šä¸ªå°äº‹åŠ¡
â”œâ”€â”€ æ‰¹é‡å¤„ç†ï¼šåˆ†æ‰¹æ¬¡å¤„ç†å¤§é‡æ•°æ®
â”œâ”€â”€ å¼‚æ­¥å¤„ç†ï¼šéæ ¸å¿ƒæ“ä½œå¼‚æ­¥æ‰§è¡Œ  
â””â”€â”€ è¶…æ—¶è®¾ç½®ï¼šè®¾ç½®äº‹åŠ¡è¶…æ—¶è‡ªåŠ¨å›æ»š

æ•°æ®åº“å±‚é¢é…ç½®ï¼š
â”œâ”€â”€ innodb_lock_wait_timeoutï¼šé”ç­‰å¾…è¶…æ—¶æ—¶é—´
â”œâ”€â”€ max_execution_timeï¼šSQLæ‰§è¡Œè¶…æ—¶æ—¶é—´
â”œâ”€â”€ transaction_timeoutï¼šäº‹åŠ¡æ€»ä½“è¶…æ—¶æ—¶é—´
â””â”€â”€ å®šæœŸæ¸…ç†ï¼šè‡ªåŠ¨ç»ˆæ­¢å¼‚å¸¸é•¿äº‹åŠ¡
```

**ğŸ”§ å¤§æ‰¹é‡DMLæ“ä½œä¼˜åŒ–**
```sql
-- é”™è¯¯åšæ³•ï¼šä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰æ•°æ®
START TRANSACTION;
UPDATE large_table SET status = 'PROCESSED' WHERE date < '2025-01-01';  -- å¯èƒ½å½±å“ç™¾ä¸‡è¡Œ
COMMIT;  -- é•¿äº‹åŠ¡é£é™©

-- æ­£ç¡®åšæ³•ï¼šåˆ†æ‰¹å¤„ç†
DELIMITER $$
CREATE PROCEDURE batch_update()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE batch_size INT DEFAULT 1000;
    DECLARE affected_rows INT;
    
    REPEAT
        START TRANSACTION;
        UPDATE large_table 
        SET status = 'PROCESSED' 
        WHERE date < '2025-01-01' 
          AND status != 'PROCESSED' 
        LIMIT batch_size;
        
        SET affected_rows = ROW_COUNT();
        COMMIT;
        
        -- å°å¹…ä¼‘çœ é¿å…æŒç»­é«˜è´Ÿè½½
        SELECT SLEEP(0.1);
    UNTIL affected_rows < batch_size END REPEAT;
END $$
DELIMITER ;
```

---

## 5. ğŸŒ åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æœºåˆ¶


### 5.1 åˆ†å¸ƒå¼äº‹åŠ¡çš„æŒ‘æˆ˜


**ğŸ”¸ åˆ†å¸ƒå¼ç¯å¢ƒçš„å¤æ‚æ€§**
```
å•æœºäº‹åŠ¡ vs åˆ†å¸ƒå¼äº‹åŠ¡ï¼š

å•æœºäº‹åŠ¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨      â”‚
â”‚     â”‚       â”‚
â”‚     â–¼       â”‚
â”‚  MySQL      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç®€å•ï¼šæ‰€æœ‰æ“ä½œåœ¨ä¸€ä¸ªæ•°æ®åº“å†…

åˆ†å¸ƒå¼äº‹åŠ¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨    â”‚    â”‚ åº”ç”¨    â”‚    â”‚ åº”ç”¨    â”‚
â”‚   â”‚     â”‚    â”‚   â”‚     â”‚    â”‚   â”‚     â”‚
â”‚   â–¼     â”‚    â”‚   â–¼     â”‚    â”‚   â–¼     â”‚
â”‚MySQL A  â”‚    â”‚MySQL B  â”‚    â”‚Redis    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å¤æ‚ï¼šæ“ä½œè·¨è¶Šå¤šä¸ªæ•°æ®æºï¼Œéœ€è¦åè°ƒä¸€è‡´æ€§
```

**âš ï¸ åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¸å‹é—®é¢˜**
```
ç½‘ç»œåˆ†åŒºï¼š
â€¢ ç½‘ç»œæ•…éšœå¯¼è‡´éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•é€šä¿¡
â€¢ å¯èƒ½é€ æˆæ•°æ®ä¸ä¸€è‡´

èŠ‚ç‚¹æ•…éšœï¼š
â€¢ æŸä¸ªæ•°æ®åº“èŠ‚ç‚¹å®•æœº
â€¢ äº‹åŠ¡æ‰§è¡Œåˆ°ä¸€åŠæ— æ³•ç»§ç»­

æ—¶é’Ÿåå·®ï¼š
â€¢ ä¸åŒèŠ‚ç‚¹çš„æ—¶é—´ä¸åŒæ­¥
â€¢ å½±å“äº‹åŠ¡çš„æ—¶åºåˆ¤æ–­

æ•°æ®ä¸ä¸€è‡´ï¼š
â€¢ éƒ¨åˆ†æ“ä½œæˆåŠŸï¼Œéƒ¨åˆ†æ“ä½œå¤±è´¥
â€¢ ç³»ç»Ÿå¤„äºä¸ä¸€è‡´çŠ¶æ€
```

### 5.2 åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ


#### ğŸ”„ ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰åè®®


**ğŸ”¸ 2PCå·¥ä½œåŸç†**
```
è§’è‰²å®šä¹‰ï¼š
â”œâ”€â”€ äº‹åŠ¡åè°ƒå™¨ï¼ˆTransaction Coordinatorï¼‰ï¼šè´Ÿè´£åè°ƒæ•´ä¸ªäº‹åŠ¡
â””â”€â”€ èµ„æºç®¡ç†å™¨ï¼ˆResource Managerï¼‰ï¼šå®é™…æ‰§è¡Œæ“ä½œçš„æ•°æ®åº“

æ‰§è¡Œé˜¶æ®µï¼š
é˜¶æ®µ1ï¼šå‡†å¤‡é˜¶æ®µï¼ˆPrepare Phaseï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åè°ƒå™¨     â”‚    â”‚   èŠ‚ç‚¹A     â”‚    â”‚   èŠ‚ç‚¹B     â”‚
â”‚             â”‚â”€â”€â”€â”€â†’â”‚  å‡†å¤‡æäº¤   â”‚    â”‚             â”‚
â”‚  å‘é€PREPAREâ”‚    â”‚  â†“         â”‚    â”‚             â”‚
â”‚             â”‚    â”‚  è¿”å›YES    â”‚â”€â”€â”€â”€â†’â”‚   å‡†å¤‡æäº¤   â”‚
â”‚             â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â†“        â”‚
â”‚             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  è¿”å›YES    â”‚
â”‚  æ”¶é›†æŠ•ç¥¨   â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2ï¼šæäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åè°ƒå™¨     â”‚    â”‚   èŠ‚ç‚¹A     â”‚    â”‚   èŠ‚ç‚¹B     â”‚
â”‚             â”‚â”€â”€â”€â”€â†’â”‚  æ‰§è¡ŒCOMMIT â”‚    â”‚             â”‚
â”‚ å‘é€COMMIT  â”‚    â”‚     â†“       â”‚    â”‚             â”‚
â”‚             â”‚    â”‚   å®Œæˆæäº¤   â”‚â”€â”€â”€â”€â†’â”‚ æ‰§è¡ŒCOMMIT  â”‚
â”‚             â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â†“      â”‚
â”‚             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   å®Œæˆæäº¤  â”‚
â”‚  ç¡®è®¤å®Œæˆ   â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš–ï¸ 2PCä¼˜ç¼ºç‚¹åˆ†æ**
```
ä¼˜ç‚¹ï¼š
âœ… ä¿è¯å¼ºä¸€è‡´æ€§ï¼šæ‰€æœ‰èŠ‚ç‚¹æ•°æ®å®Œå…¨ä¸€è‡´
âœ… å®ç°ç›¸å¯¹ç®€å•ï¼šæ¦‚å¿µæ¸…æ™°ï¼Œæ˜“äºç†è§£
âœ… å¹¿æ³›æ”¯æŒï¼šå¤§éƒ¨åˆ†æ•°æ®åº“éƒ½æ”¯æŒXAåè®®

ç¼ºç‚¹ï¼š  
âŒ æ€§èƒ½å¼€é”€å¤§ï¼šéœ€è¦å¤šæ¬¡ç½‘ç»œé€šä¿¡
âŒ é˜»å¡é—®é¢˜ï¼šå‡†å¤‡é˜¶æ®µä¼šé”å®šèµ„æº
âŒ å•ç‚¹æ•…éšœï¼šåè°ƒå™¨æ•…éšœå½±å“æ•´ä¸ªç³»ç»Ÿ
âŒ æ•°æ®ä¸å¯ç”¨ï¼šæ•…éšœæœŸé—´å¯èƒ½é•¿æ—¶é—´é˜»å¡
```

#### ğŸ¯ è¡¥å¿äº‹åŠ¡ï¼ˆSagaï¼‰æ¨¡å¼


**ğŸ”¸ Sagaæ¨¡å¼åŸç†**
```
æ ¸å¿ƒæ€æƒ³ï¼šå°†åˆ†å¸ƒå¼äº‹åŠ¡åˆ†è§£ä¸ºå¤šä¸ªæœ¬åœ°äº‹åŠ¡
è¡¥å¿æœºåˆ¶ï¼šæ¯ä¸ªæœ¬åœ°äº‹åŠ¡éƒ½æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œ
å®ç°æ–¹å¼ï¼šæ­£å‘æ‰§è¡Œ + åå‘è¡¥å¿

è®¢å•å¤„ç†Sagaç¤ºä¾‹ï¼š
æ­¥éª¤1ï¼šåˆ›å»ºè®¢å•ï¼ˆæœ¬åœ°äº‹åŠ¡1ï¼‰
  â””â”€â”€ è¡¥å¿ï¼šå–æ¶ˆè®¢å•
æ­¥éª¤2ï¼šæ‰£å‡åº“å­˜ï¼ˆæœ¬åœ°äº‹åŠ¡2ï¼‰  
  â””â”€â”€ è¡¥å¿ï¼šæ¢å¤åº“å­˜
æ­¥éª¤3ï¼šæ‰£é™¤ä½™é¢ï¼ˆæœ¬åœ°äº‹åŠ¡3ï¼‰
  â””â”€â”€ è¡¥å¿ï¼šé€€è¿˜ä½™é¢
æ­¥éª¤4ï¼šå‘é€ç¡®è®¤ï¼ˆæœ¬åœ°äº‹åŠ¡4ï¼‰
  â””â”€â”€ è¡¥å¿ï¼šå‘é€å–æ¶ˆé€šçŸ¥
```

**ğŸ’¡ Sagaæ‰§è¡Œæµç¨‹**
```
æ­£å¸¸æ‰§è¡Œæµç¨‹ï¼š
T1 â†’ T2 â†’ T3 â†’ T4 ï¼ˆå…¨éƒ¨æˆåŠŸï¼‰

å¼‚å¸¸æ‰§è¡Œæµç¨‹ï¼ˆT3å¤±è´¥ï¼‰ï¼š
T1 â†’ T2 â†’ T3âŒ â†’ C2 â†’ C1 ï¼ˆæ‰§è¡Œè¡¥å¿æ“ä½œï¼‰
```

### 5.3 MySQLåˆ†å¸ƒå¼äº‹åŠ¡å®è·µ


**ğŸ”§ MySQL XAäº‹åŠ¡ä½¿ç”¨**
```sql
-- MySQL XAäº‹åŠ¡ç¤ºä¾‹
-- åœ¨èŠ‚ç‚¹Aä¸Šæ‰§è¡Œ
XA START 'xid_node_a';
UPDATE accounts SET balance = balance - 100 WHERE id = 'A001';
XA END 'xid_node_a';
XA PREPARE 'xid_node_a';

-- åœ¨èŠ‚ç‚¹Bä¸Šæ‰§è¡Œ  
XA START 'xid_node_b';
UPDATE accounts SET balance = balance + 100 WHERE id = 'B001';
XA END 'xid_node_b'; 
XA PREPARE 'xid_node_b';

-- åè°ƒå™¨å†³å®šæäº¤
XA COMMIT 'xid_node_a';
XA COMMIT 'xid_node_b';
```

**ğŸ¯ å®è·µå»ºè®®**
- **å°½é‡é¿å…**ï¼šåˆ†å¸ƒå¼äº‹åŠ¡å¤æ‚åº¦é«˜ï¼Œä¼˜å…ˆè€ƒè™‘ä¸šåŠ¡æ‹†åˆ†
- **å¿…é¡»ä½¿ç”¨æ—¶**ï¼šé€‰æ‹©æˆç†Ÿçš„åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶
- **æ€§èƒ½ç›‘æ§**ï¼šå¯†åˆ‡ç›‘æ§äº‹åŠ¡æ‰§è¡Œæ—¶é—´å’ŒæˆåŠŸç‡
- **é™çº§æ–¹æ¡ˆ**ï¼šå‡†å¤‡åˆ†å¸ƒå¼äº‹åŠ¡å¤±è´¥æ—¶çš„ä¸šåŠ¡é™çº§ç­–ç•¥

---

## 6. ğŸš€ äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ


### 6.1 äº‹åŠ¡è®¾è®¡åŸåˆ™


**ğŸ¯ é«˜æ€§èƒ½äº‹åŠ¡è®¾è®¡åŸåˆ™**
```
ğŸ“ äº‹åŠ¡ç²’åº¦æ§åˆ¶ï¼š
â€¢ å°½é‡å°ï¼šå‡å°‘é”æŒæœ‰æ—¶é—´
â€¢ ä¸šåŠ¡å®Œæ•´ï¼šä¿è¯ä¸šåŠ¡é€»è¾‘å®Œæ•´æ€§
â€¢ é¿å…è·¨å¤šä¸ªä¸šåŠ¡æ¨¡å—

â±ï¸ æ‰§è¡Œæ—¶é—´æ§åˆ¶ï¼š
â€¢ å¿«é€Ÿæ‰§è¡Œï¼šé¿å…åœ¨äº‹åŠ¡ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
â€¢ å‡å°‘ç­‰å¾…ï¼šé¿å…äº‹åŠ¡ä¸­è°ƒç”¨å¤–éƒ¨æœåŠ¡
â€¢ åŠæ—¶æäº¤ï¼šä¸è¦é•¿æ—¶é—´æŒæœ‰äº‹åŠ¡

ğŸ”’ é”èŒƒå›´æœ€å°åŒ–ï¼š
â€¢ ç²¾ç¡®æ¡ä»¶ï¼šWHEREæ¡ä»¶å°½é‡ç²¾ç¡®
â€¢ åˆé€‚ç´¢å¼•ï¼šåˆ©ç”¨ç´¢å¼•å‡å°‘é”å®šèŒƒå›´
â€¢ æ“ä½œé¡ºåºï¼šç»Ÿä¸€çš„èµ„æºè®¿é—®é¡ºåºé¿å…æ­»é”
```

### 6.2 DMLæ“ä½œä¼˜åŒ–æŠ€å·§


#### ğŸ“Š æ‰¹é‡DMLä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ æ‰¹é‡INSERTä¼˜åŒ–**
```sql
-- ä½æ•ˆåšæ³•ï¼šé€æ¡æ’å…¥
START TRANSACTION;
INSERT INTO products (name, price) VALUES ('Product1', 99.99);
INSERT INTO products (name, price) VALUES ('Product2', 199.99);
-- ... é‡å¤1000æ¬¡
COMMIT;

-- é«˜æ•ˆåšæ³•ï¼šæ‰¹é‡æ’å…¥
START TRANSACTION;
INSERT INTO products (name, price) VALUES
('Product1', 99.99),
('Product2', 199.99),
('Product3', 299.99),
-- ... ä¸€æ¬¡æ’å…¥å¤šè¡Œ
('Product1000', 9999.99);
COMMIT;

æ€§èƒ½æå‡ï¼š
â€¢ å‡å°‘äº‹åŠ¡å¼€é”€ï¼šä»1000ä¸ªäº‹åŠ¡å˜ä¸º1ä¸ªäº‹åŠ¡
â€¢ å‡å°‘ç½‘ç»œå¾€è¿”ï¼šä»1000æ¬¡ç½‘ç»œè°ƒç”¨å˜ä¸º1æ¬¡
â€¢ æå‡ååé‡ï¼šæ‰¹é‡æ“ä½œæ•ˆç‡å¯æå‡10-50å€
```

**âš¡ æ‰¹é‡UPDATEä¼˜åŒ–**
```sql
-- ä½¿ç”¨æ‰¹é‡æ›´æ–°è¯­æ³•
UPDATE products 
SET price = CASE 
    WHEN product_id = 'P001' THEN 99.99
    WHEN product_id = 'P002' THEN 199.99
    WHEN product_id = 'P003' THEN 299.99
    ELSE price 
END
WHERE product_id IN ('P001', 'P002', 'P003');

-- åˆ†æ‰¹å¤„ç†å¤§é‡æ›´æ–°
DELIMITER $$
CREATE PROCEDURE batch_update_status()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE batch_count INT DEFAULT 0;
    
    REPEAT
        START TRANSACTION;
        UPDATE orders 
        SET status = 'SHIPPED' 
        WHERE status = 'PENDING' 
          AND order_date < DATE_SUB(NOW(), INTERVAL 1 DAY)
        LIMIT 500;  -- æ¯æ‰¹500æ¡
        
        SET batch_count = ROW_COUNT();
        COMMIT;
        
        SELECT SLEEP(0.1);  -- ä¼‘çœ é¿å…æŒç»­é«˜è´Ÿè½½
    UNTIL batch_count < 500 END REPEAT;
END $$
```

#### ğŸ¯ äº‹åŠ¡éš”ç¦»çº§åˆ«è°ƒä¼˜


**ğŸ”¸ æ ¹æ®ä¸šåŠ¡è°ƒæ•´éš”ç¦»çº§åˆ«**
```sql
-- ä¸´æ—¶è°ƒæ•´ä¼šè¯éš”ç¦»çº§åˆ«
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- é’ˆå¯¹ç‰¹å®šæŸ¥è¯¢é™ä½éš”ç¦»çº§åˆ«
START TRANSACTION;
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
SELECT COUNT(*) FROM large_table WHERE date = CURDATE();  -- å¿«é€Ÿç»Ÿè®¡
COMMIT;

-- é’ˆå¯¹å…³é”®æ“ä½œæé«˜éš”ç¦»çº§åˆ«
START TRANSACTION;
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
UPDATE account SET balance = balance - @amount WHERE id = @account_id;
INSERT INTO transactions (account_id, amount, type) VALUES (@account_id, @amount, 'DEBIT');
COMMIT;
```

### 6.3 æ­»é”é¢„é˜²ä¸å¤„ç†


**ğŸ”’ æ­»é”äº§ç”ŸåŸç†**
```
æ­»é”åœºæ™¯æ¼”ç¤ºï¼š
æ—¶é—´ | äº‹åŠ¡A                    | äº‹åŠ¡B
-----|-------------------------|-------------------------
T1   | LOCK è®¢å•è¡¨ è¡Œ1         |
T2   |                        | LOCK åº“å­˜è¡¨ è¡Œ1  
T3   | ç­‰å¾… åº“å­˜è¡¨ è¡Œ1 é”      |
T4   |                        | ç­‰å¾… è®¢å•è¡¨ è¡Œ1 é”
T5   | ğŸ’€æ­»é”æ£€æµ‹ï¼Œå›æ»šäº‹åŠ¡A   |

æ­»é”å½¢æˆï¼š
äº‹åŠ¡Aç­‰å¾…äº‹åŠ¡BæŒæœ‰çš„é”
äº‹åŠ¡Bç­‰å¾…äº‹åŠ¡AæŒæœ‰çš„é”
å½¢æˆå¾ªç¯ç­‰å¾…ï¼Œé™·å…¥æ­»é”
```

**ğŸ›¡ï¸ æ­»é”é¢„é˜²ç­–ç•¥**
```
èµ„æºè®¿é—®é¡ºåºç»Ÿä¸€ï¼š
-- æ‰€æœ‰äº‹åŠ¡æŒ‰ç›¸åŒé¡ºåºè®¿é—®èµ„æº
-- äº‹åŠ¡1å’Œäº‹åŠ¡2éƒ½æŒ‰ï¼šè®¢å•è¡¨ â†’ åº“å­˜è¡¨ â†’ æ”¯ä»˜è¡¨

äº‹åŠ¡ç²’åº¦æ§åˆ¶ï¼š
-- å‡å°‘äº‹åŠ¡æŒæœ‰é”çš„æ—¶é—´
-- å°†ä¸ç›¸å…³æ“ä½œç§»å‡ºäº‹åŠ¡

ç´¢å¼•ä¼˜åŒ–ï¼š
-- ç¡®ä¿WHEREæ¡ä»¶èƒ½ä½¿ç”¨ç´¢å¼•
-- å‡å°‘é”å®šçš„è¡Œæ•°

è¶…æ—¶æœºåˆ¶ï¼š
-- è®¾ç½®åˆç†çš„é”ç­‰å¾…è¶…æ—¶æ—¶é—´
-- innodb_lock_wait_timeout = 5ï¼ˆ5ç§’è¶…æ—¶ï¼‰
```

### 6.4 äº‹åŠ¡æ€§èƒ½ç›‘æ§


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```sql
-- äº‹åŠ¡å¤„ç†ç»Ÿè®¡
SHOW ENGINE INNODB STATUS\G

å…³é”®æŒ‡æ ‡è§£è¯»ï¼š
â”œâ”€â”€ Trx id counterï¼šäº‹åŠ¡IDè®¡æ•°å™¨ï¼Œåæ˜ äº‹åŠ¡å¤„ç†é‡
â”œâ”€â”€ History list lengthï¼šå†å²è®°å½•é•¿åº¦ï¼Œè¿‡é•¿å½±å“æ€§èƒ½
â”œâ”€â”€ Log sequence numberï¼šæ—¥å¿—åºåˆ—å·ï¼Œåæ˜ å†™å…¥é‡
â””â”€â”€ Pending reads/writesï¼šç­‰å¾…çš„è¯»å†™æ“ä½œæ•°é‡

-- é”ç­‰å¾…ç›‘æ§
SELECT 
    COUNT(*) AS waiting_transactions,
    AVG(wait_time) AS avg_wait_time,
    MAX(wait_time) AS max_wait_time
FROM 
    performance_schema.events_waits_current 
WHERE 
    event_name LIKE '%wait/synch/mutex%';
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡ACIDç‰¹æ€§ï¼šåŸå­æ€§ä¿è¯å®Œæ•´æ€§ï¼Œä¸€è‡´æ€§ä¿è¯æ­£ç¡®æ€§ï¼Œéš”ç¦»æ€§ä¿è¯å¹¶å‘å®‰å…¨ï¼ŒæŒä¹…æ€§ä¿è¯æ•°æ®ä¸ä¸¢å¤±
ğŸ”¸ éš”ç¦»çº§åˆ«é€‰æ‹©ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚å¹³è¡¡ä¸€è‡´æ€§å’Œæ€§èƒ½ï¼Œå¤§éƒ¨åˆ†åœºæ™¯READ COMMITTEDè¶³å¤Ÿ
ğŸ”¸ é•¿äº‹åŠ¡å±å®³ï¼šå ç”¨èµ„æºã€é˜»å¡å¹¶å‘ã€å½±å“æ€§èƒ½ï¼Œå¿…é¡»ä¸¥æ ¼æ§åˆ¶
ğŸ”¸ åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¤æ‚åº¦é«˜ã€æ€§èƒ½å¼€é”€å¤§ï¼Œä¼˜å…ˆè€ƒè™‘ä¸šåŠ¡æ‹†åˆ†é¿å…ä½¿ç”¨
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæ‰¹é‡æ“ä½œã€åˆç†éš”ç¦»çº§åˆ«ã€æ­»é”é¢„é˜²ã€ç›‘æ§å‘Šè­¦
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ äº‹åŠ¡æ˜¯æ•°æ®å®‰å…¨çš„åŸºçŸ³**
```
ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡ï¼š
â€¢ ä¿è¯ä¸šåŠ¡æ“ä½œçš„å®Œæ•´æ€§ï¼šè½¬è´¦ä¸èƒ½åªæ‰£é’±ä¸åŠ é’±
â€¢ ç¡®ä¿å¹¶å‘å®‰å…¨ï¼šå¤šç”¨æˆ·åŒæ—¶æ“ä½œä¸ä¼šå†²çª
â€¢ æä¾›é”™è¯¯æ¢å¤ï¼šæ“ä½œå¤±è´¥æ—¶èƒ½å®Œå…¨æ’¤é”€
â€¢ ç»´æŠ¤æ•°æ®ä¸€è‡´æ€§ï¼šæ•°æ®å§‹ç»ˆç¬¦åˆä¸šåŠ¡è§„åˆ™
```

**ğŸ”¹ éš”ç¦»çº§åˆ«çš„å®é™…æ„ä¹‰**
```
éš”ç¦»çº§åˆ«é€‰æ‹©ç­–ç•¥ï¼š
â€¢ æ•°æ®å‡†ç¡®æ€§ä¼˜å…ˆï¼šé‡‘èç³»ç»Ÿé€‰æ‹©é«˜éš”ç¦»çº§åˆ«
â€¢ æ€§èƒ½ä¼˜å…ˆï¼šæ—¥å¿—åˆ†æç³»ç»Ÿé€‰æ‹©ä½éš”ç¦»çº§åˆ«
â€¢ å¹³è¡¡è€ƒè™‘ï¼šå¤§éƒ¨åˆ†ä¸šåŠ¡é€‰æ‹©READ COMMITTED
â€¢ é»˜è®¤è®¾ç½®ï¼šMySQLé»˜è®¤REPEATABLE READé€šå¸¸è¶³å¤Ÿ
```

**ğŸ”¹ é•¿äº‹åŠ¡æ§åˆ¶çš„é‡è¦æ€§**
```
æ§åˆ¶é•¿äº‹åŠ¡å°±æ˜¯æ§åˆ¶ç³»ç»Ÿé£é™©ï¼š
â€¢ é¢„é˜²æ­»é”ï¼šé¿å…èµ„æºäº‰ç”¨
â€¢ ä¿éšœæ€§èƒ½ï¼šå‡å°‘é”ç­‰å¾…æ—¶é—´
â€¢ ç¡®ä¿å¯ç”¨æ€§ï¼šé¿å…ç³»ç»Ÿé˜»å¡
â€¢ ä¾¿äºè¿ç»´ï¼šå‡å°‘é—®é¢˜æ’æŸ¥éš¾åº¦
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä¼ä¸šçº§äº‹åŠ¡ç®¡ç†æœ€ä½³å®è·µ**

```
å¼€å‘é˜¶æ®µï¼š
â”œâ”€â”€ äº‹åŠ¡è¾¹ç•Œè®¾è®¡ï¼šæ˜ç¡®æ¯ä¸ªäº‹åŠ¡çš„å¼€å§‹å’Œç»“æŸ
â”œâ”€â”€ å¼‚å¸¸å¤„ç†ï¼šä¸ºæ¯ä¸ªäº‹åŠ¡è®¾è®¡å®Œå–„çš„é”™è¯¯å¤„ç†
â”œâ”€â”€ æµ‹è¯•éªŒè¯ï¼šæ¨¡æ‹Ÿå„ç§å¼‚å¸¸æƒ…å†µæµ‹è¯•äº‹åŠ¡è¡Œä¸º
â””â”€â”€ æ€§èƒ½æµ‹è¯•ï¼šè¯„ä¼°äº‹åŠ¡å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“

è¿ç»´é˜¶æ®µï¼š  
â”œâ”€â”€ ç›‘æ§å‘Šè­¦ï¼šå®æ—¶ç›‘æ§é•¿äº‹åŠ¡å’Œæ­»é”æƒ…å†µ
â”œâ”€â”€ å‚æ•°è°ƒä¼˜ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´äº‹åŠ¡ç›¸å…³å‚æ•°
â”œâ”€â”€ å¤‡ä»½ç­–ç•¥ï¼šè€ƒè™‘äº‹åŠ¡å¯¹å¤‡ä»½ä¸€è‡´æ€§çš„å½±å“
â””â”€â”€ æ•…éšœå¤„ç†ï¼šå»ºç«‹äº‹åŠ¡ç›¸å…³æ•…éšœçš„å¤„ç†æµç¨‹
```

**ğŸ”§ äº‹åŠ¡ä½¿ç”¨ç»éªŒæ€»ç»“**
- **äº‹åŠ¡è¦çŸ­å°ç²¾æ‚**ï¼šåªåŒ…å«å¿…è¦çš„DMLæ“ä½œ
- **é¿å…äººå·¥äº¤äº’**ï¼šäº‹åŠ¡ä¸­ä¸è¦ç­‰å¾…ç”¨æˆ·è¾“å…¥
- **åˆç†è®¾ç½®è¶…æ—¶**ï¼šé˜²æ­¢å¼‚å¸¸æƒ…å†µä¸‹çš„èµ„æºå ç”¨
- **ç›‘æ§æ˜¯å…³é”®**ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†äº‹åŠ¡é—®é¢˜
- **æµ‹è¯•è¦å……åˆ†**ï¼šå¹¶å‘åœºæ™¯ä¸‹çš„äº‹åŠ¡è¡Œä¸ºæµ‹è¯•

**æ ¸å¿ƒè®°å¿†**ï¼š
- äº‹åŠ¡æ˜¯DMLæ“ä½œçš„å®‰å…¨ä¿éšœï¼ŒACIDç‰¹æ€§ç¼ºä¸€ä¸å¯
- éš”ç¦»çº§åˆ«è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ï¼Œä¸æ˜¯è¶Šé«˜è¶Šå¥½
- é•¿äº‹åŠ¡æ˜¯æ€§èƒ½æ€æ‰‹ï¼Œå¿…é¡»ä¸¥æ ¼æ§åˆ¶å’Œç›‘æ§
- åˆ†å¸ƒå¼äº‹åŠ¡è¦è°¨æ…ä½¿ç”¨ï¼Œä¼˜å…ˆè€ƒè™‘æ¶æ„æ‹†åˆ†
- æ€§èƒ½ä¼˜åŒ–ä»äº‹åŠ¡è®¾è®¡å¼€å§‹ï¼Œç›‘æ§å’Œè°ƒä¼˜å¹¶é‡