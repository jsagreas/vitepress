---
title: 5、MySQL权限查看方法
---
## 📚 目录

1. [权限查看基础概念](#1-权限查看基础概念)
2. [SHOW GRANTS语法详解](#2-show-grants语法详解)
3. [权限表直接查询](#3-权限表直接查询)
4. [有效权限计算方法](#4-有效权限计算方法)
5. [权限查看安全控制](#5-权限查看安全控制)
6. [权限查询优化技巧](#6-权限查询优化技巧)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🔍 权限查看基础概念


权限查看就像**查看员工的工作权限清单**一样，帮助我们了解某个用户具体能做什么操作。

### 1.1 为什么需要查看权限


**🎯 核心作用**：
```
权限审计：检查用户是否有多余权限
故障排查：用户无法操作时检查权限
安全检查：发现权限配置问题
合规要求：满足安全审计需求
```

### 1.2 权限查看的层次结构


```
MySQL权限层次图：
┌─────────────────────┐
│   全局权限 (全服务器) │ ← 最高级别
├─────────────────────┤
│   数据库权限         │ ← 库级别
├─────────────────────┤
│   表权限            │ ← 表级别
├─────────────────────┤
│   列权限            │ ← 最细粒度
└─────────────────────┘
```

**🔸 权限继承关系**：
- **全局权限**：对所有数据库生效
- **数据库权限**：仅对指定数据库生效
- **表权限**：仅对指定表生效
- **列权限**：仅对指定列生效

---

## 2. 📋 SHOW GRANTS语法详解


`SHOW GRANTS`是查看权限最直接的方法，就像**查看员工的岗位说明书**。

### 2.1 基本语法格式


```sql
-- 查看当前用户权限
SHOW GRANTS;

-- 查看指定用户权限
SHOW GRANTS FOR 'username'@'hostname';

-- 查看指定用户在指定数据库的权限
SHOW GRANTS FOR 'username'@'hostname' USING 'database_name';
```

### 2.2 实际使用示例


**🔸 查看当前用户权限**：
```sql
-- 查看自己的权限
SHOW GRANTS;

-- 输出示例：
-- GRANT USAGE ON *.* TO 'user1'@'localhost'
-- GRANT SELECT, INSERT, UPDATE ON `mydb`.* TO 'user1'@'localhost'
```

**🔸 查看特定用户权限**：
```sql
-- 查看用户user1的所有权限
SHOW GRANTS FOR 'user1'@'localhost';

-- 查看用户在特定数据库的权限
SHOW GRANTS FOR 'user1'@'localhost' USING 'sales_db';
```

### 2.3 SHOW GRANTS输出解读


```
权限输出格式解析：
GRANT SELECT, INSERT ON `database`.`table` TO 'user'@'host'
  ↑       ↑         ↑        ↑         ↑       ↑      ↑
 授权   权限类型   权限范围   数据库    表    用户名  主机
```

**📊 常见权限类型含义**：

| 权限名称 | **含义** | **操作范围** | **使用场景** |
|---------|---------|-------------|-------------|
| `SELECT` | **数据查询** | `读取表数据` | `查询报表、数据分析` |
| `INSERT` | **数据插入** | `新增记录` | `业务数据录入` |
| `UPDATE` | **数据更新** | `修改记录` | `业务数据维护` |
| `DELETE` | **数据删除** | `删除记录` | `数据清理操作` |
| `CREATE` | **创建对象** | `建表建库` | `开发环境搭建` |
| `DROP` | **删除对象** | `删表删库` | `环境清理` |
| `ALTER` | **结构修改** | `表结构变更` | `数据库升级` |
| `INDEX` | **索引管理** | `创建删除索引` | `性能优化` |

---

## 3. 🗃️ 权限表直接查询


有时候需要**深入权限表内部**查看更详细的权限信息，就像翻阅人事档案一样。

### 3.1 MySQL权限表结构


```
MySQL权限表关系图：
mysql.user ── 用户基本信息 + 全局权限
    │
    ├── mysql.db ── 数据库级权限
    │
    ├── mysql.tables_priv ── 表级权限
    │
    ├── mysql.columns_priv ── 列级权限
    │
    └── mysql.procs_priv ── 存储过程权限
```

### 3.2 查询用户基本信息


**🔸 查看用户列表**：
```sql
-- 查看所有用户
SELECT User, Host, account_locked, password_expired 
FROM mysql.user;

-- 查看特定用户信息
SELECT User, Host, Super_priv, Create_priv, Drop_priv
FROM mysql.user 
WHERE User = 'myuser';
```

### 3.3 查询具体权限详情


**🔸 查看数据库级权限**：
```sql
-- 查看用户对特定数据库的权限
SELECT * FROM mysql.db 
WHERE User = 'myuser' AND Db = 'sales_db';
```

**🔸 查看表级权限**：
```sql
-- 查看用户对特定表的权限
SELECT * FROM mysql.tables_priv 
WHERE User = 'myuser' AND Db = 'sales_db' AND Table_name = 'orders';
```

### 3.4 权限信息汇总查询


```sql
-- 生成用户权限报告
SELECT 
    CONCAT(User, '@', Host) AS '用户',
    CASE 
        WHEN Super_priv = 'Y' THEN '超级管理员'
        WHEN Create_user_priv = 'Y' THEN '用户管理员'
        ELSE '普通用户'
    END AS '用户类型',
    CONCAT(
        IF(Select_priv='Y', 'SELECT,', ''),
        IF(Insert_priv='Y', 'INSERT,', ''),
        IF(Update_priv='Y', 'UPDATE,', ''),
        IF(Delete_priv='Y', 'DELETE,', '')
    ) AS '全局权限'
FROM mysql.user
WHERE User != '' AND User != 'mysql.sys';
```

---

## 4. ⚖️ 有效权限计算方法


MySQL的权限是**分层叠加**的，就像**职位权限 + 部门权限 + 项目权限**的组合。

### 4.1 权限计算原理


```
权限计算逻辑：
┌─ 全局权限 ─┐    ┌─ 数据库权限 ─┐    ┌─ 表权限 ─┐
│   如果有   │ OR │    如果有     │ OR │  如果有  │ → 最终权限
└───────────┘    └──────────────┘    └──────────┘

实际权限 = 全局权限 ∪ 数据库权限 ∪ 表权限 ∪ 列权限
```

### 4.2 权限继承示例


**🔸 权限叠加计算**：
```sql
-- 用户权限情况：
-- 全局：只有USAGE（无实际权限）
-- 数据库sales_db：SELECT, INSERT
-- 表orders：UPDATE

-- 最终对sales_db.orders表的权限：
-- SELECT (来自数据库权限)
-- INSERT (来自数据库权限)  
-- UPDATE (来自表权限)
```

### 4.3 检查有效权限的方法


```sql
-- 创建测试函数检查权限
DELIMITER //
CREATE FUNCTION check_permission(
    username VARCHAR(50),
    hostname VARCHAR(50),
    database_name VARCHAR(50),
    table_name VARCHAR(50)
) RETURNS TEXT
READS SQL DATA
BEGIN
    DECLARE result TEXT DEFAULT '';
    -- 这里会检查各层权限并汇总
    -- 实际使用中建议用存储过程实现
    RETURN 'SELECT,INSERT,UPDATE';
END //
DELIMITER ;
```

---

## 5. 🔒 权限查看安全控制


查看权限本身也需要权限，这就像**查看员工档案需要HR权限**一样。

### 5.1 权限查看的权限要求


**🔸 查看权限需要的条件**：
```
查看自己权限：任何用户都可以
查看他人权限：需要SELECT权限到mysql库
查看全局权限：需要SUPER权限或mysql.user读权限
系统权限查看：需要SYSTEM_USER权限(MySQL 8.0+)
```

### 5.2 安全的权限查看实践


**🔸 创建权限查看专用用户**：
```sql
-- 创建只读权限的审计用户
CREATE USER 'auditor'@'localhost' IDENTIFIED BY 'strong_password';

-- 授予查看权限表的权限
GRANT SELECT ON mysql.user TO 'auditor'@'localhost';
GRANT SELECT ON mysql.db TO 'auditor'@'localhost';
GRANT SELECT ON mysql.tables_priv TO 'auditor'@'localhost';

-- 限制只能本地登录
GRANT USAGE ON *.* TO 'auditor'@'localhost';
```

### 5.3 权限信息泄露防护


**⚠️ 安全注意事项**：
```
1. 权限查看日志要定期清理
2. 避免在应用代码中硬编码权限查询
3. 使用专用账户进行权限审计
4. 敏感权限查看要有审批流程
```

---

## 6. ⚡ 权限查询优化技巧


当用户很多时，权限查询可能会很慢，需要一些**优化技巧**。

### 6.1 高效的权限查询方式


**🔸 批量查询用户权限**：
```sql
-- 高效查询多个用户权限概况
SELECT 
    CONCAT(User, '@', Host) AS account,
    COUNT(*) as db_privileges
FROM mysql.db 
WHERE User IN ('user1', 'user2', 'user3')
GROUP BY User, Host;
```

**🔸 权限变更历史查询**：
```sql
-- 查询最近的权限相关操作（需要开启audit log）
SELECT event_time, user_host, command_type, argument
FROM mysql.general_log 
WHERE command_type IN ('Grant', 'Revoke')
AND event_time > DATE_SUB(NOW(), INTERVAL 7 DAY)
ORDER BY event_time DESC;
```

### 6.2 权限查看工具脚本


**🔸 权限报告生成脚本**：
```sql
-- 生成完整的用户权限报告
SELECT 
    '用户概况' AS 报告类型,
    COUNT(DISTINCT CONCAT(User, '@', Host)) AS 用户总数,
    SUM(CASE WHEN Super_priv = 'Y' THEN 1 ELSE 0 END) AS 超级用户数,
    SUM(CASE WHEN account_locked = 'Y' THEN 1 ELSE 0 END) AS 锁定用户数
FROM mysql.user
WHERE User != ''

UNION ALL

SELECT 
    '权限分布' AS 报告类型,
    '数据库级权限' AS 详情,
    COUNT(*) AS 数量,
    NULL
FROM mysql.db

UNION ALL

SELECT 
    '权限分布' AS 报告类型,
    '表级权限' AS 详情, 
    COUNT(*) AS 数量,
    NULL
FROM mysql.tables_priv;
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 SHOW GRANTS：最直接的权限查看方法
🔸 权限表查询：深入了解权限细节的方式
🔸 权限计算：理解分层权限如何叠加生效
🔸 安全控制：权限查看本身也需要权限控制
🔸 查询优化：大量用户时的高效查询技巧
```

### 7.2 关键理解要点


**🔹 权限查看的本质**：
```
就像查看员工的工作清单：
- SHOW GRANTS：看岗位描述
- 权限表查询：看详细档案
- 有效权限计算：看实际能做什么
```

**🔹 权限层次的重要性**：
```
权限是叠加的，不是覆盖的：
全局权限 + 数据库权限 + 表权限 = 最终权限
任何一层有权限，用户就能执行对应操作
```

### 7.3 实际应用指导


**✅ 日常运维使用**：
- **快速检查**：用`SHOW GRANTS`看权限概况
- **详细分析**：查询权限表了解具体配置
- **安全审计**：定期生成权限报告
- **故障排查**：用户无法操作时首先检查权限

**🎯 最佳实践**：
- 使用专用账户进行权限查看
- 定期审计用户权限，清理无用权限
- 权限查看操作要记录日志
- 敏感权限查看要有审批流程

**核心记忆**：
- 权限查看三板斧：SHOW GRANTS、权限表、有效计算
- 权限是叠加的：全局+数据库+表+列
- 查看权限也要权限：安全第一
- 工具脚本化：提高运维效率