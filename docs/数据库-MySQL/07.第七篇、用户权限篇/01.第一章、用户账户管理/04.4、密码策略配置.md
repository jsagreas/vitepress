---
title: 4、密码策略配置
---
## 📚 目录

1. [密码策略基础概念](#1-密码策略基础概念)
2. [validate_password插件详解](#2-validate_password插件详解)
3. [密码强度等级配置](#3-密码强度等级配置)
4. [密码复杂度规则定制](#4-密码复杂度规则定制)
5. [密码过期策略实施](#5-密码过期策略实施)
6. [密码安全检查机制](#6-密码安全检查机制)
7. [实战应用与最佳实践](#7-实战应用与最佳实践)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔐 密码策略基础概念


### 1.1 什么是密码策略


**密码策略**就是MySQL用来管控用户密码安全性的一套规则。简单来说，就是告诉MySQL"什么样的密码才算安全"。

```
💡 通俗理解
密码策略 = 门卫检查规则
- 门卫：MySQL的密码验证组件
- 规则：密码必须满足的条件
- 检查：创建/修改密码时的验证过程
```

### 1.2 为什么需要密码策略


```
🚨 安全风险对比

无密码策略：
- 用户可设置：123、abc、root等弱密码
- 安全风险：极易被破解
- 后果：数据库被入侵

有密码策略：
- 强制要求：长度、复杂度、字符组合
- 安全等级：大幅提升
- 防护效果：有效抵御暴力破解
```

### 1.3 密码策略核心要素


```
📋 密码策略的四大支柱

1️⃣ 长度要求 → 密码最少几位字符
2️⃣ 复杂度要求 → 必须包含哪些字符类型
3️⃣ 字典检查 → 不能使用常见弱密码
4️⃣ 有效期管理 → 密码多久必须更换
```

---

## 2. ⚙️ validate_password插件详解


### 2.1 插件基本概念


**validate_password插件**是MySQL官方提供的密码验证组件，专门用来检查密码是否符合安全要求。

```sql
-- 🔍 检查插件是否已安装
SHOW PLUGINS LIKE '%validate%';

-- 📥 安装密码验证插件
INSTALL PLUGIN validate_password SONAME 'validate_password.so';
```

### 2.2 插件工作原理


```
🔄 密码验证流程

用户设置密码
      ↓
validate_password插件拦截
      ↓
按照配置的策略检查
      ↓
✅ 通过 → 允许设置
❌ 失败 → 拒绝并提示错误
```

### 2.3 插件状态查看


```sql
-- 📊 查看插件所有配置参数
SHOW VARIABLES LIKE 'validate_password%';

-- 🎯 查看插件状态
SELECT PLUGIN_NAME, PLUGIN_STATUS 
FROM INFORMATION_SCHEMA.PLUGINS 
WHERE PLUGIN_NAME = 'validate_password';
```

**常见输出解读**：
```
+--------------------------------------+-------+
| Variable_name                        | Value |
+--------------------------------------+-------+
| validate_password_check_user_name    | ON    |  ← 不能包含用户名
| validate_password_length            | 8     |  ← 最小长度8位
| validate_password_policy            | MEDIUM|  ← 中等强度策略
+--------------------------------------+-------+
```

---

## 3. 📊 密码强度等级配置


### 3.1 三种强度等级详解


MySQL提供三种预设的密码强度等级，每种等级有不同的检查规则。

```
🔒 密码强度等级对比

LOW (0) - 基础级别：
✅ 只检查密码长度
❌ 不检查字符组合

MEDIUM (1) - 中等级别：
✅ 检查长度 + 字符组合
✅ 必须包含：数字、小写字母、大写字母、特殊字符

STRONG (2) - 严格级别：
✅ 包含MEDIUM所有要求
✅ 额外检查：字典攻击防护
✅ 不能包含：用户名、常见弱密码
```

### 3.2 强度等级配置实例


```sql
-- 🔧 设置为基础级别（只检查长度）
SET GLOBAL validate_password_policy = 'LOW';

-- 🔧 设置为中等级别（推荐生产环境）
SET GLOBAL validate_password_policy = 'MEDIUM';

-- 🔧 设置为严格级别（高安全要求）
SET GLOBAL validate_password_policy = 'STRONG';
```

### 3.3 不同等级的实际效果


```sql
-- 💡 测试不同等级下的密码要求

-- LOW级别下，这些密码都能通过：
CREATE USER 'test1'@'localhost' IDENTIFIED BY '12345678';  -- ✅
CREATE USER 'test2'@'localhost' IDENTIFIED BY 'aaaaaaaa';  -- ✅

-- MEDIUM级别下，必须有字符组合：
CREATE USER 'test3'@'localhost' IDENTIFIED BY 'Abc123!@';  -- ✅
CREATE USER 'test4'@'localhost' IDENTIFIED BY '12345678';  -- ❌ 缺少字母和特殊字符

-- STRONG级别下，还要避免字典词汇：
CREATE USER 'test5'@'localhost' IDENTIFIED BY 'Password123!'; -- ❌ 包含字典词
CREATE USER 'test6'@'localhost' IDENTIFIED BY 'MyS3cur3P@ss'; -- ✅
```

---

## 4. 🎯 密码复杂度规则定制


### 4.1 长度要求配置


**密码长度**是最基础但也是最重要的安全要求。

```sql
-- 📏 设置最小密码长度（推荐8-16位）
SET GLOBAL validate_password_length = 12;

-- 🔍 查看当前长度要求
SELECT $$validate_password_length;
```

```
📊 长度安全性对比

6位密码：几分钟可破解
8位密码：几小时可破解  ← MySQL默认
12位密码：几年可破解   ← 推荐设置
16位密码：几十年破解  ← 高安全要求
```

### 4.2 字符类型要求配置


配置密码必须包含的不同字符类型数量。

```sql
-- 🔤 设置必须包含的数字个数
SET GLOBAL validate_password_number_count = 2;

-- 🔠 设置必须包含的小写字母个数  
SET GLOBAL validate_password_lowercase_count = 2;

-- 🔡 设置必须包含的大写字母个数
SET GLOBAL validate_password_uppercase_count = 1;

-- 🔣 设置必须包含的特殊字符个数
SET GLOBAL validate_password_special_char_count = 1;
```

**配置示例效果**：
```
根据上述配置，密码必须包含：
✅ 至少2个数字：12
✅ 至少2个小写字母：ab  
✅ 至少1个大写字母：A
✅ 至少1个特殊字符：!

有效密码示例：MyPass12!
无效密码示例：mypass123（缺少大写字母和特殊字符）
```

### 4.3 用户名检查配置


防止密码中包含用户名，避免简单的用户名+数字组合。

```sql
-- 🚫 禁止密码包含用户名
SET GLOBAL validate_password_check_user_name = ON;

-- 📝 测试效果
CREATE USER 'john'@'localhost' IDENTIFIED BY 'john123!A';  -- ❌ 包含用户名
CREATE USER 'john'@'localhost' IDENTIFIED BY 'mypass123!A'; -- ✅ 不包含用户名
```

---

## 5. ⏰ 密码过期策略实施


### 5.1 密码过期基本概念


**密码过期**是指强制用户在指定时间后必须更换密码，防止长期使用同一密码带来的安全风险。

```
🕐 密码生命周期管理

创建密码 → 正常使用 → 接近过期 → 强制更换 → 新密码生效
    ↓         ↓         ↓         ↓         ↓
   Day 1    Day 85    Day 90    Day 91    Day 1
```

### 5.2 全局密码过期策略


```sql
-- ⚙️ 设置全局密码过期天数（对所有新用户生效）
SET GLOBAL default_password_lifetime = 90;

-- 🔍 查看当前全局策略
SELECT $$default_password_lifetime;

-- 💡 禁用全局密码过期（设为0）
SET GLOBAL default_password_lifetime = 0;
```

### 5.3 单个用户密码过期策略


```sql
-- 👤 为特定用户设置密码过期策略

-- 设置60天过期
ALTER USER 'john'@'localhost' PASSWORD EXPIRE INTERVAL 60 DAY;

-- 设置永不过期
ALTER USER 'admin'@'localhost' PASSWORD EXPIRE NEVER;

-- 立即过期（强制下次登录时更换）
ALTER USER 'temp_user'@'localhost' PASSWORD EXPIRE;

-- 使用全局默认策略
ALTER USER 'normal_user'@'localhost' PASSWORD EXPIRE DEFAULT;
```

### 5.4 密码过期状态查看


```sql
-- 📋 查看用户密码过期信息
SELECT 
    User,
    Host,
    password_expired,
    password_last_changed,
    password_lifetime
FROM mysql.user 
WHERE User = 'john';
```

---

## 6. 🛡️ 密码安全检查机制


### 6.1 弱密码检测机制


MySQL通过内置的字典和算法来检测常见的弱密码模式。

```
🚨 常见弱密码类型

字典攻击类：
❌ password、123456、admin、root
❌ qwerty、abc123、welcome

模式攻击类：
❌ 纯数字：123456789
❌ 纯字母：abcdefgh  
❌ 键盘序列：qwerty、asdf
❌ 重复字符：aaaa1111
```

### 6.2 密码强度评分算法


MySQL内部使用评分算法来判断密码强度。

```sql
-- 🧮 使用VALIDATE_PASSWORD_STRENGTH函数测试密码强度
SELECT VALIDATE_PASSWORD_STRENGTH('123456');      -- 返回: 25 (弱)
SELECT VALIDATE_PASSWORD_STRENGTH('Abc123!@');    -- 返回: 75 (中)  
SELECT VALIDATE_PASSWORD_STRENGTH('MyS3cur3P@ss'); -- 返回: 100 (强)
```

**评分标准**：
```
📊 密码强度评分

0-25分：极弱密码 🔴
26-50分：弱密码 🟡  
51-75分：中等密码 🟠
76-100分：强密码 🟢
```

### 6.3 自定义密码规则


通过配置文件实现更复杂的密码规则。

```ini
# 📄 my.cnf配置文件示例
[mysqld]
# 密码策略配置
validate_password_policy=STRONG
validate_password_length=12
validate_password_number_count=2
validate_password_lowercase_count=2
validate_password_uppercase_count=2
validate_password_special_char_count=2
validate_password_check_user_name=ON
```

---

## 7. 🚀 实战应用与最佳实践


### 7.1 生产环境推荐配置


```sql
-- 🏭 生产环境密码策略最佳实践

-- 1. 启用严格密码策略
SET GLOBAL validate_password_policy = 'STRONG';

-- 2. 设置合理的密码长度
SET GLOBAL validate_password_length = 12;

-- 3. 要求字符组合多样性
SET GLOBAL validate_password_number_count = 2;
SET GLOBAL validate_password_lowercase_count = 2;
SET GLOBAL validate_password_uppercase_count = 1;
SET GLOBAL validate_password_special_char_count = 2;

-- 4. 启用用户名检查
SET GLOBAL validate_password_check_user_name = ON;

-- 5. 设置密码过期策略
SET GLOBAL default_password_lifetime = 90;
```

### 7.2 不同场景的策略选择


```
🎯 策略选择指南

开发环境：
- 策略等级：LOW
- 密码长度：8位
- 过期策略：永不过期
- 目的：便于开发测试

测试环境：  
- 策略等级：MEDIUM
- 密码长度：10位
- 过期策略：180天
- 目的：接近生产环境

生产环境：
- 策略等级：STRONG  
- 密码长度：12位
- 过期策略：90天
- 目的：最高安全级别
```

### 7.3 密码策略违规处理


```sql
-- 🚨 处理密码策略违规的实用技巧

-- 临时降低策略等级（紧急情况）
SET GLOBAL validate_password_policy = 'LOW';
-- 创建用户后立即恢复
SET GLOBAL validate_password_policy = 'STRONG';

-- 批量重置过期密码用户
SELECT CONCAT('ALTER USER ''', User, '''@''', Host, ''' PASSWORD EXPIRE;') 
FROM mysql.user 
WHERE password_expired = 'Y';
```

### 7.4 监控与审计


```sql
-- 📊 密码安全审计查询

-- 查看密码即将过期的用户
SELECT 
    User, 
    Host,
    password_last_changed,
    DATEDIFF(DATE_ADD(password_last_changed, INTERVAL $$default_password_lifetime DAY), NOW()) AS days_until_expire
FROM mysql.user 
WHERE password_last_changed IS NOT NULL
    AND DATEDIFF(DATE_ADD(password_last_changed, INTERVAL $$default_password_lifetime DAY), NOW()) <= 7;

-- 查看从未更改过密码的用户
SELECT User, Host 
FROM mysql.user 
WHERE password_last_changed IS NULL;
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 密码策略：MySQL控制密码安全性的规则集合
🔸 validate_password插件：官方密码验证组件
🔸 三种强度等级：LOW（基础）、MEDIUM（推荐）、STRONG（严格）
🔸 复杂度要求：长度、字符类型、字典检查、用户名检查
🔸 过期策略：强制定期更换密码的安全机制
```

### 8.2 关键配置参数速查


| 参数名称 | **作用** | **推荐值** | **说明** |
|---------|---------|-----------|---------|
| `validate_password_policy` | `策略等级` | `STRONG` | `生产环境使用严格策略` |
| `validate_password_length` | `最小长度` | `12` | `平衡安全性和易用性` |
| `validate_password_check_user_name` | `用户名检查` | `ON` | `禁止密码包含用户名` |
| `default_password_lifetime` | `过期天数` | `90` | `定期强制更换密码` |

### 8.3 实际应用价值


**🏢 企业级应用**：
- 满足合规要求（如等保、ISO27001）
- 防止数据泄露和未授权访问
- 建立完整的密码安全基线

**🔧 运维实践**：
- 自动化密码策略部署
- 定期密码安全审计
- 用户密码健康度监控

**💡 安全最佳实践**：
```
记住3个关键点：
1. 策略配置要分环境：开发宽松，生产严格
2. 密码复杂度要平衡：既要安全，又要可用
3. 过期策略要合理：既要安全，又要避免频繁打扰
```

**核心记忆口诀**：
```
🧠 密码策略配置要诀
策略强度分三级，长度复杂度并行
用户名称要检查，过期时间定周期  
生产环境从严管，开发测试可宽松
```