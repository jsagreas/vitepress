---
title: 5ã€è§’è‰²ç»§æ‰¿å…³ç³»
---
## ğŸ“š ç›®å½•

1. [è§’è‰²ç»§æ‰¿åŸºæœ¬æ¦‚å¿µ](#1-è§’è‰²ç»§æ‰¿åŸºæœ¬æ¦‚å¿µ)
2. [è§’è‰²å±‚æ¬¡ç»“æ„è®¾è®¡](#2-è§’è‰²å±‚æ¬¡ç»“æ„è®¾è®¡)
3. [è§’è‰²åµŒå¥—æˆäºˆæœºåˆ¶](#3-è§’è‰²åµŒå¥—æˆäºˆæœºåˆ¶)
4. [ç»§æ‰¿æƒé™è®¡ç®—è§„åˆ™](#4-ç»§æ‰¿æƒé™è®¡ç®—è§„åˆ™)
5. [å¾ªç¯å¼•ç”¨æ£€æµ‹ä¸é˜²æŠ¤](#5-å¾ªç¯å¼•ç”¨æ£€æµ‹ä¸é˜²æŠ¤)
6. [è§’è‰²ä¾èµ–å…³ç³»ç®¡ç†](#6-è§’è‰²ä¾èµ–å…³ç³»ç®¡ç†)
7. [ç»§æ‰¿é“¾æŸ¥è¯¢ä¸åˆ†æ](#7-ç»§æ‰¿é“¾æŸ¥è¯¢ä¸åˆ†æ)
8. [è§’è‰²ç»§æ‰¿å®‰å…¨æ§åˆ¶](#8-è§’è‰²ç»§æ‰¿å®‰å…¨æ§åˆ¶)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è§’è‰²ç»§æ‰¿åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è§’è‰²ç»§æ‰¿


**ç®€å•ç†è§£**ï¼šè§’è‰²ç»§æ‰¿å°±åƒå…¬å¸èŒä½çš„æƒé™ä¼ é€’ï¼Œä¸Šçº§èŒä½çš„æƒé™ä¼šè‡ªåŠ¨ä¼ ç»™ä¸‹çº§èŒä½ã€‚

```
ç°å®ä¾‹å­ï¼š
æ€»ç»ç† â†’ æ‹¥æœ‰æ‰€æœ‰æƒé™
éƒ¨é—¨ç»ç† â†’ ç»§æ‰¿æ€»ç»ç†æƒé™ + è‡ªå·±çš„ç‰¹æ®Šæƒé™  
æ™®é€šå‘˜å·¥ â†’ ç»§æ‰¿éƒ¨é—¨ç»ç†æƒé™ + è‡ªå·±çš„åŸºç¡€æƒé™

MySQLä¸­ï¼š
é«˜çº§è§’è‰² â†’ æ‹¥æœ‰æ ¸å¿ƒæƒé™
ä¸­çº§è§’è‰² â†’ ç»§æ‰¿é«˜çº§è§’è‰²æƒé™ + ä¸“ä¸šæƒé™
åŸºç¡€è§’è‰² â†’ ç»§æ‰¿ä¸­çº§è§’è‰²æƒé™ + åŸºæœ¬æƒé™
```

### 1.2 è§’è‰²ç»§æ‰¿çš„æ ¸å¿ƒä½œç”¨


**ğŸ”¸ æƒé™ç®¡ç†ç®€åŒ–**
- **é¿å…é‡å¤æˆæƒ**ï¼šä¸ç”¨ç»™æ¯ä¸ªè§’è‰²å•ç‹¬æˆäºˆç›¸åŒæƒé™
- **ç»Ÿä¸€æƒé™æ§åˆ¶**ï¼šä¿®æ”¹çˆ¶è§’è‰²æƒé™ï¼Œå­è§’è‰²è‡ªåŠ¨ç”Ÿæ•ˆ
- **å±‚æ¬¡åŒ–ç®¡ç†**ï¼šæƒé™åˆ†å±‚ç®¡ç†ï¼Œç»“æ„æ¸…æ™°

**ğŸ”¸ å®‰å…¨æ€§ä¿éšœ**
- **æœ€å°æƒé™åŸåˆ™**ï¼šæ¯ä¸ªè§’è‰²åªæœ‰å¿…éœ€çš„æƒé™
- **æƒé™éš”ç¦»**ï¼šä¸åŒå±‚çº§çš„æƒé™ç›¸äº’ç‹¬ç«‹
- **å®¡è®¡è¿½è¸ª**ï¼šæƒé™æ¥æºæ¸…æ™°å¯è¿½æº¯

### 1.3 MySQLè§’è‰²ç»§æ‰¿ç‰¹ç‚¹


```sql
-- MySQL 8.0å¼€å§‹æ”¯æŒè§’è‰²ç»§æ‰¿
-- è§’è‰²å¯ä»¥è¢«æˆäºˆç»™å…¶ä»–è§’è‰²ï¼Œå½¢æˆç»§æ‰¿å…³ç³»

-- ğŸ”¸ åŸºæœ¬è¯­æ³•
GRANT role_name TO another_role_name;

-- ğŸ”¸ æƒé™ä¼ é€’ç‰¹ç‚¹
çˆ¶è§’è‰²æƒé™ â†’ è‡ªåŠ¨ä¼ é€’ç»™å­è§’è‰²
å­è§’è‰²æƒé™ â†’ ä¸ä¼šå½±å“çˆ¶è§’è‰²
å¤šå±‚ç»§æ‰¿ â†’ æ”¯æŒå¤šçº§æƒé™ä¼ é€’
```

---

## 2. ğŸ—ï¸ è§’è‰²å±‚æ¬¡ç»“æ„è®¾è®¡


### 2.1 å¸¸è§çš„è§’è‰²å±‚æ¬¡æ¨¡å‹


**ğŸ“Š é‡‘å­—å¡”å±‚æ¬¡ç»“æ„**
```
              ğŸ›ï¸ è¶…çº§ç®¡ç†å‘˜
                    |
         ğŸ”§ ç³»ç»Ÿç®¡ç†å‘˜    ğŸ“Š æ•°æ®åˆ†æå¸ˆ
             |              |
      ğŸ‘¤ æ™®é€šç”¨æˆ·      ğŸ“ˆ æŠ¥è¡¨ç”¨æˆ·
```

**ğŸŒ³ éƒ¨é—¨è§’è‰²æ ‘ç»“æ„**
```
                å…¬å¸ç®¡ç†å‘˜
                /       \
        æŠ€æœ¯éƒ¨ç®¡ç†         è´¢åŠ¡éƒ¨ç®¡ç†
         /     \           /      \
   å¼€å‘ç»„é•¿   è¿ç»´ç»„é•¿   ä¼šè®¡ä¸»ç®¡  å‡ºçº³å‘˜
     |        |          |       |
   ç¨‹åºå‘˜   ç³»ç»Ÿç®¡ç†    ä¼šè®¡å¸ˆ   å‡ºçº³
```

### 2.2 è§’è‰²å±‚æ¬¡è®¾è®¡åŸåˆ™


**ğŸ¯ è®¾è®¡æŒ‡å¯¼åŸåˆ™**

| åŸåˆ™ | **è¯´æ˜** | **ç¤ºä¾‹** |
|------|---------|---------|
| `ğŸ”º å±‚æ¬¡æ¸…æ™°` | `æ¯å±‚è§’è‰²èŒè´£æ˜ç¡®` | `ç®¡ç†å‘˜â†’ç»„é•¿â†’å‘˜å·¥` |
| `âš¡ æƒé™é€’å‡` | `ä¸‹çº§æƒé™ä¸è¶…è¿‡ä¸Šçº§` | `ç®¡ç†å‘˜æƒé™æœ€å¤§` |
| `ğŸ”’ æœ€å°æˆæƒ` | `åªç»™å¿…éœ€çš„æƒé™` | `æŸ¥è¯¢å‘˜å·¥åªç»™SELECTæƒé™` |
| `ğŸ”„ æ˜“äºç»´æŠ¤` | `ç»“æ„ç®€å•ï¼Œä¾¿äºç®¡ç†` | `é¿å…è¿‡æ·±çš„åµŒå¥—` |

### 2.3 å®é™…å±‚æ¬¡ç»“æ„ç¤ºä¾‹


```sql
-- åˆ›å»ºåˆ†å±‚è§’è‰²ç»“æ„
-- ğŸ›ï¸ ç¬¬ä¸€å±‚ï¼šè¶…çº§ç®¡ç†å‘˜
CREATE ROLE 'super_admin';
GRANT ALL PRIVILEGES ON *.* TO 'super_admin';

-- ğŸ”§ ç¬¬äºŒå±‚ï¼šéƒ¨é—¨ç®¡ç†å‘˜  
CREATE ROLE 'dept_manager';
GRANT SELECT, INSERT, UPDATE, DELETE ON company.* TO 'dept_manager';

-- ğŸ‘¥ ç¬¬ä¸‰å±‚ï¼šç»„é•¿
CREATE ROLE 'team_leader'; 
GRANT SELECT, INSERT, UPDATE ON company.employees TO 'team_leader';
GRANT SELECT ON company.projects TO 'team_leader';

-- ğŸ‘¤ ç¬¬å››å±‚ï¼šæ™®é€šå‘˜å·¥
CREATE ROLE 'employee';
GRANT SELECT ON company.employees TO 'employee';

-- å»ºç«‹ç»§æ‰¿å…³ç³»
GRANT 'dept_manager' TO 'super_admin';
GRANT 'team_leader' TO 'dept_manager';  
GRANT 'employee' TO 'team_leader';
```

---

## 3. ğŸ”— è§’è‰²åµŒå¥—æˆäºˆæœºåˆ¶


### 3.1 è§’è‰²åµŒå¥—çš„åŸºæœ¬è¯­æ³•


**ç®€å•ç†è§£**ï¼šè§’è‰²åµŒå¥—å°±æ˜¯æŠŠä¸€ä¸ªè§’è‰²çš„æƒé™æ‰“åŒ…ç»™å¦ä¸€ä¸ªè§’è‰²ï¼Œå°±åƒç»™å‘˜å·¥å‘æ”¾ä¸åŒçº§åˆ«çš„å·¥ä½œè¯ã€‚

```sql
-- ğŸ”¸ åŸºæœ¬åµŒå¥—è¯­æ³•
GRANT role1 TO role2;  -- role2ç»§æ‰¿role1çš„æ‰€æœ‰æƒé™

-- ğŸ”¸ å¤šè§’è‰²åµŒå¥—
GRANT role1, role2, role3 TO target_role;  -- ç»§æ‰¿å¤šä¸ªè§’è‰²

-- ğŸ”¸ ç”¨æˆ·è·å¾—è§’è‰²
GRANT role_name TO user_name;  -- ç”¨æˆ·è·å¾—è§’è‰²æƒé™
```

### 3.2 åµŒå¥—æˆäºˆçš„å·¥ä½œæœºåˆ¶


**ğŸ”„ æƒé™ä¼ é€’æµç¨‹**
```
æ­¥éª¤1ï¼šåˆ›å»ºåŸºç¡€è§’è‰²
   â†“
æ­¥éª¤2ï¼šä¸ºè§’è‰²æˆäºˆå…·ä½“æƒé™  
   â†“
æ­¥éª¤3ï¼šå°†è§’è‰²æˆäºˆç»™å…¶ä»–è§’è‰²(åµŒå¥—)
   â†“
æ­¥éª¤4ï¼šæƒé™è‡ªåŠ¨ä¼ é€’ç»™ç›®æ ‡è§’è‰²
   â†“
æ­¥éª¤5ï¼šç”¨æˆ·è·å¾—è§’è‰²åæ‹¥æœ‰å…¨éƒ¨ç»§æ‰¿æƒé™
```

### 3.3 å®é™…åµŒå¥—ç¤ºä¾‹


```sql
-- ğŸ¯ åˆ›å»ºåŸºç¡€æƒé™è§’è‰²
CREATE ROLE 'read_data';
GRANT SELECT ON sales.* TO 'read_data';

CREATE ROLE 'write_data';  
GRANT INSERT, UPDATE ON sales.orders TO 'write_data';

CREATE ROLE 'delete_data';
GRANT DELETE ON sales.temp_* TO 'delete_data';

-- ğŸ”§ åˆ›å»ºç»„åˆè§’è‰²ï¼Œç»§æ‰¿åŸºç¡€æƒé™
CREATE ROLE 'data_analyst';
GRANT 'read_data' TO 'data_analyst';  -- ç»§æ‰¿æŸ¥è¯¢æƒé™

CREATE ROLE 'sales_manager';
GRANT 'read_data', 'write_data' TO 'sales_manager';  -- ç»§æ‰¿è¯»å†™æƒé™

CREATE ROLE 'admin_user';
GRANT 'read_data', 'write_data', 'delete_data' TO 'admin_user';  -- ç»§æ‰¿å…¨éƒ¨æƒé™

-- ğŸ‘¤ ç”¨æˆ·è·å¾—è§’è‰²
CREATE USER 'john'@'localhost' IDENTIFIED BY 'password';
GRANT 'sales_manager' TO 'john'@'localhost';

-- johnç”¨æˆ·ç°åœ¨æ‹¥æœ‰ï¼šread_data + write_data çš„æ‰€æœ‰æƒé™
```

### 3.4 åµŒå¥—æƒé™çš„æ¿€æ´»æœºåˆ¶


```sql
-- ğŸ”¸ æŸ¥çœ‹ç”¨æˆ·çš„è§’è‰²
SELECT * FROM information_schema.applicable_roles 
WHERE GRANTEE = "'john'@'localhost'";

-- ğŸ”¸ æ¿€æ´»è§’è‰²æƒé™
SET ROLE 'sales_manager';  -- æ¿€æ´»ç‰¹å®šè§’è‰²
SET ROLE ALL;              -- æ¿€æ´»æ‰€æœ‰å·²æˆäºˆçš„è§’è‰²
SET ROLE NONE;             -- å–æ¶ˆæ¿€æ´»æ‰€æœ‰è§’è‰²

-- ğŸ”¸ è®¾ç½®é»˜è®¤è§’è‰²(ç™»å½•æ—¶è‡ªåŠ¨æ¿€æ´»)
SET DEFAULT ROLE 'sales_manager' TO 'john'@'localhost';
```

---

## 4. âš–ï¸ ç»§æ‰¿æƒé™è®¡ç®—è§„åˆ™


### 4.1 æƒé™åˆå¹¶è®¡ç®—åŸç†


**ç®€å•ç†è§£**ï¼šå°±åƒæ”¶é›†å¡ç‰‡æ¸¸æˆï¼Œæ¯ä¸ªè§’è‰²éƒ½æœ‰è‡ªå·±çš„æƒé™å¡ç‰‡ï¼Œç»§æ‰¿æ—¶ä¼šæŠŠæ‰€æœ‰å¡ç‰‡åˆå¹¶åœ¨ä¸€èµ·ã€‚

**ğŸ”¸ æƒé™åˆå¹¶è§„åˆ™**
```
æœ€ç»ˆæƒé™ = ç›´æ¥æƒé™ âˆª ç»§æ‰¿æƒé™1 âˆª ç»§æ‰¿æƒé™2 âˆª ...

è®¡ç®—è¿‡ç¨‹ï¼š
1. æ”¶é›†è§’è‰²çš„ç›´æ¥æƒé™
2. æ”¶é›†æ‰€æœ‰çˆ¶è§’è‰²çš„æƒé™  
3. é€’å½’æ”¶é›†ç¥–å…ˆè§’è‰²çš„æƒé™
4. åˆå¹¶æ‰€æœ‰æƒé™(å–å¹¶é›†)
5. åº”ç”¨æƒé™é™åˆ¶å’Œçº¦æŸ
```

### 4.2 æƒé™è®¡ç®—ç¤ºä¾‹


```sql
-- ğŸ¯ æƒé™ç»§æ‰¿è®¡ç®—ç¤ºä¾‹
-- è§’è‰²Aï¼šæ‹¥æœ‰ SELECT æƒé™
CREATE ROLE 'role_a';
GRANT SELECT ON test.table1 TO 'role_a';

-- è§’è‰²Bï¼šæ‹¥æœ‰ INSERT æƒé™  
CREATE ROLE 'role_b';
GRANT INSERT ON test.table1 TO 'role_b';

-- è§’è‰²Cï¼šç»§æ‰¿Aå’ŒBçš„æƒé™ï¼Œå¹¶æ‹¥æœ‰è‡ªå·±çš„ UPDATE æƒé™
CREATE ROLE 'role_c';
GRANT UPDATE ON test.table1 TO 'role_c';
GRANT 'role_a', 'role_b' TO 'role_c';

-- role_cçš„æœ€ç»ˆæƒé™ = SELECT + INSERT + UPDATE
```

### 4.3 æƒé™ä¼˜å…ˆçº§è§„åˆ™


**ğŸ”º æƒé™ä¼˜å…ˆçº§åŸåˆ™**

| ä¼˜å…ˆçº§ | **æƒé™ç±»å‹** | **è¯´æ˜** |
|--------|-------------|----------|
| `ğŸ¥‡ æœ€é«˜` | `ç›´æ¥DENYæƒé™` | `æ˜ç¡®æ‹’ç»çš„æƒé™` |
| `ğŸ¥ˆ é«˜` | `ç›´æ¥GRANTæƒé™` | `ç›´æ¥æˆäºˆçš„æƒé™` |
| `ğŸ¥‰ ä¸­` | `ç»§æ‰¿GRANTæƒé™` | `ä»çˆ¶è§’è‰²ç»§æ‰¿çš„æƒé™` |
| `ğŸ“ ä½` | `é»˜è®¤æƒé™` | `ç³»ç»Ÿé»˜è®¤æƒé™` |

```sql
-- ğŸ”¸ æƒé™è¦†ç›–ç¤ºä¾‹
-- çˆ¶è§’è‰²æœ‰SELECTæƒé™
CREATE ROLE 'parent_role';
GRANT SELECT ON test.* TO 'parent_role';

-- å­è§’è‰²ç»§æ‰¿åï¼Œåˆè¢«æ˜ç¡®æ‹’ç»SELECTæƒé™
CREATE ROLE 'child_role';  
GRANT 'parent_role' TO 'child_role';
-- æ³¨æ„ï¼šMySQLæ²¡æœ‰DENYè¯­æ³•ï¼Œè¿™é‡Œæ˜¯æ¦‚å¿µè¯´æ˜
-- åœ¨MySQLä¸­ï¼Œæƒé™æ˜¯ç´¯ç§¯çš„ï¼Œä¸ä¼šè¢«è¦†ç›–
```

### 4.4 æƒé™è®¡ç®—æŸ¥è¯¢æ–¹æ³•


```sql
-- ğŸ” æŸ¥è¯¢è§’è‰²çš„æœ‰æ•ˆæƒé™
-- æŸ¥çœ‹è§’è‰²è¢«æˆäºˆçš„æƒé™
SHOW GRANTS FOR 'role_name';

-- æŸ¥çœ‹ç”¨æˆ·é€šè¿‡è§’è‰²è·å¾—çš„æƒé™
SHOW GRANTS FOR 'user'@'host' USING 'role_name';

-- æŸ¥è¯¢æƒé™è¯¦ç»†ä¿¡æ¯
SELECT * FROM information_schema.role_table_grants 
WHERE GRANTEE = "'role_name'";

-- æŸ¥è¯¢ç»§æ‰¿å…³ç³»é“¾
SELECT * FROM information_schema.applicable_roles 
WHERE ROLE_NAME = 'role_name';
```

---

## 5. ğŸ”„ å¾ªç¯å¼•ç”¨æ£€æµ‹ä¸é˜²æŠ¤


### 5.1 ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨


**ç®€å•ç†è§£**ï¼šå¾ªç¯å¼•ç”¨å°±åƒ"çŸ³å¤´å‰ªåˆ€å¸ƒ"çš„å¾ªç¯å…³ç³»ï¼ŒAç®¡Bï¼ŒBç®¡Cï¼ŒCåˆç®¡Aï¼Œè¿™æ ·å°±å½¢æˆäº†æ­»å¾ªç¯ã€‚

```
âŒ å¾ªç¯å¼•ç”¨ç¤ºä¾‹ï¼š
è§’è‰²A â†’ ç»§æ‰¿è§’è‰²Bçš„æƒé™
è§’è‰²B â†’ ç»§æ‰¿è§’è‰²Cçš„æƒé™  
è§’è‰²C â†’ ç»§æ‰¿è§’è‰²Açš„æƒé™
ç»“æœï¼šå½¢æˆAâ†’Bâ†’Câ†’Açš„å¾ªç¯
```

**ğŸš¨ å¾ªç¯å¼•ç”¨çš„å±å®³**
- **æ— é™é€’å½’**ï¼šæƒé™è®¡ç®—è¿›å…¥æ­»å¾ªç¯
- **ç³»ç»Ÿæ€§èƒ½**ï¼šæ¶ˆè€—å¤§é‡è®¡ç®—èµ„æº
- **ç®¡ç†æ··ä¹±**ï¼šè§’è‰²å…³ç³»ä¸æ¸…æ™°
- **å®‰å…¨é£é™©**ï¼šæƒé™è¾¹ç•Œæ¨¡ç³Š

### 5.2 MySQLçš„å¾ªç¯å¼•ç”¨é˜²æŠ¤æœºåˆ¶


```sql
-- ğŸ”¸ MySQLè‡ªåŠ¨æ£€æµ‹å¾ªç¯å¼•ç”¨
-- å½“å°è¯•åˆ›å»ºå¾ªç¯å¼•ç”¨æ—¶ï¼Œç³»ç»Ÿä¼šæŠ¥é”™

-- ç¤ºä¾‹ï¼šåˆ›å»ºå¾ªç¯å¼•ç”¨(ä¼šå¤±è´¥)
CREATE ROLE 'role_a', 'role_b', 'role_c';

GRANT 'role_b' TO 'role_a';  -- Aç»§æ‰¿B âœ“
GRANT 'role_c' TO 'role_b';  -- Bç»§æ‰¿C âœ“  
GRANT 'role_a' TO 'role_c';  -- Cç»§æ‰¿A âŒ ç³»ç»Ÿæ‹’ç»

-- é”™è¯¯ä¿¡æ¯ï¼šERROR 3530 (HY000): `role_c`@`%` is a circular role grant.
```

### 5.3 å¾ªç¯å¼•ç”¨æ£€æµ‹ç®—æ³•


**ğŸ” æ·±åº¦ä¼˜å…ˆæœç´¢æ£€æµ‹**
```
ç®—æ³•æ­¥éª¤ï¼š
1. ä»ç›®æ ‡è§’è‰²å¼€å§‹éå†
2. è®°å½•è®¿é—®è¿‡çš„è§’è‰²è·¯å¾„
3. å¦‚æœé‡åˆ°å·²è®¿é—®çš„è§’è‰² â†’ å‘ç°å¾ªç¯
4. å¦‚æœéå†å®Œæˆæ— é‡å¤ â†’ æ— å¾ªç¯

ä¼ªä»£ç ï¼š
function detectCycle(role, visited, path):
    if role in path:
        return true  // å‘ç°å¾ªç¯
    if role in visited:
        return false // å·²æ£€æŸ¥è¿‡ï¼Œæ— å¾ªç¯
    
    path.add(role)
    for parent_role in getParentRoles(role):
        if detectCycle(parent_role, visited, path):
            return true
    path.remove(role)
    visited.add(role)
    return false
```

### 5.4 æ‰‹åŠ¨æ£€æµ‹å¾ªç¯å¼•ç”¨


```sql
-- ğŸ”§ æŸ¥è¯¢è§’è‰²ç»§æ‰¿å…³ç³»ï¼Œæ‰‹åŠ¨æ£€æµ‹å¾ªç¯
-- åˆ›å»ºé€’å½’æŸ¥è¯¢æ£€æµ‹ç»§æ‰¿é“¾
WITH RECURSIVE role_hierarchy AS (
  -- åŸºç¡€æŸ¥è¯¢ï¼šæ‰€æœ‰ç›´æ¥ç»§æ‰¿å…³ç³»
  SELECT 
    FROM_USER as child_role,
    TO_USER as parent_role,
    1 as level,
    CAST(FROM_USER AS CHAR(1000)) as path
  FROM mysql.role_edges
  
  UNION ALL
  
  -- é€’å½’æŸ¥è¯¢ï¼šå¤šçº§ç»§æ‰¿å…³ç³»
  SELECT 
    rh.child_role,
    re.TO_USER as parent_role,
    rh.level + 1,
    CONCAT(rh.path, ' -> ', re.TO_USER)
  FROM role_hierarchy rh
  JOIN mysql.role_edges re ON rh.parent_role = re.FROM_USER
  WHERE rh.level < 10  -- é™åˆ¶é€’å½’æ·±åº¦ï¼Œé˜²æ­¢æ— é™å¾ªç¯
)
SELECT * FROM role_hierarchy
WHERE FIND_IN_SET(parent_role, REPLACE(path, ' -> ', ',')) > 0;
-- å¦‚æœæœ‰ç»“æœï¼Œè¯´æ˜å­˜åœ¨å¾ªç¯å¼•ç”¨
```

---

## 6. ğŸ”— è§’è‰²ä¾èµ–å…³ç³»ç®¡ç†


### 6.1 è§’è‰²ä¾èµ–å…³ç³»æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šè§’è‰²ä¾èµ–å°±åƒæ­ç§¯æœ¨ï¼Œä¸‹é¢çš„ç§¯æœ¨è¢«æ‹¿æ‰äº†ï¼Œä¸Šé¢çš„ç§¯æœ¨å°±ä¼šå€’å¡Œã€‚æŸä¸ªè§’è‰²è¢«åˆ é™¤æˆ–ä¿®æ”¹ï¼Œä¼šå½±å“ä¾èµ–å®ƒçš„å…¶ä»–è§’è‰²ã€‚

**ğŸ”¸ ä¾èµ–å…³ç³»ç±»å‹**
```
ç›´æ¥ä¾èµ–ï¼šè§’è‰²Aç›´æ¥ç»§æ‰¿è§’è‰²B
é—´æ¥ä¾èµ–ï¼šè§’è‰²Aé€šè¿‡è§’è‰²Cç»§æ‰¿è§’è‰²B  
å¼ºä¾èµ–ï¼šåˆ é™¤çˆ¶è§’è‰²ä¼šå½±å“å­è§’è‰²åŠŸèƒ½
å¼±ä¾èµ–ï¼šåˆ é™¤çˆ¶è§’è‰²ä¸å½±å“å­è§’è‰²åŸºæœ¬åŠŸèƒ½
```

### 6.2 ä¾èµ–å…³ç³»å›¾åˆ†æ


```
ğŸ“Š è§’è‰²ä¾èµ–å…³ç³»å›¾ï¼š

     super_admin (è¶…çº§ç®¡ç†å‘˜)
          |
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    |           |
dept_admin   sys_admin (éƒ¨é—¨ç®¡ç†å‘˜, ç³»ç»Ÿç®¡ç†å‘˜)
    |           |
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    |           |
team_lead   operator (ç»„é•¿, æ“ä½œå‘˜)
    |           |
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          |
      employee (æ™®é€šå‘˜å·¥)

ä¾èµ–åˆ†æï¼š
- employee ä¾èµ–äº team_lead å’Œ operator
- team_lead ä¾èµ–äº dept_admin  
- dept_admin ä¾èµ–äº super_admin
```

### 6.3 ä¾èµ–å…³ç³»æŸ¥è¯¢


```sql
-- ğŸ” æŸ¥è¯¢è§’è‰²çš„ä¾èµ–å…³ç³»

-- æŸ¥è¯¢æŒ‡å®šè§’è‰²ä¾èµ–çš„æ‰€æœ‰çˆ¶è§’è‰²
SELECT 
    FROM_USER as child_role,
    TO_USER as parent_role,
    'direct' as dependency_type
FROM mysql.role_edges 
WHERE FROM_USER = 'target_role'

UNION ALL

-- æŸ¥è¯¢é—´æ¥ä¾èµ–(é€’å½’æŸ¥è¯¢)
WITH RECURSIVE role_deps AS (
    SELECT FROM_USER as child, TO_USER as parent, 1 as level
    FROM mysql.role_edges 
    WHERE FROM_USER = 'target_role'
    
    UNION ALL
    
    SELECT rd.child, re.TO_USER, rd.level + 1
    FROM role_deps rd
    JOIN mysql.role_edges re ON rd.parent = re.FROM_USER
    WHERE rd.level < 5
)
SELECT child as child_role, parent as parent_role, 'indirect' as dependency_type
FROM role_deps WHERE level > 1;
```

### 6.4 ä¾èµ–å…³ç³»å½±å“åˆ†æ


```sql
-- ğŸ¯ åˆ†æåˆ é™¤è§’è‰²çš„å½±å“èŒƒå›´

-- æŸ¥è¯¢å“ªäº›è§’è‰²ä¾èµ–äºç›®æ ‡è§’è‰²
SELECT 
    FROM_USER as affected_role,
    TO_USER as deleted_role,
    'will_lose_permissions' as impact
FROM mysql.role_edges 
WHERE TO_USER = 'role_to_delete';

-- æŸ¥è¯¢å“ªäº›ç”¨æˆ·ä¼šå—å½±å“
SELECT DISTINCT
    grantee as affected_user,
    'role_to_delete' as deleted_role
FROM information_schema.applicable_roles ar
JOIN mysql.role_edges re ON ar.role_name = re.FROM_USER
WHERE re.TO_USER = 'role_to_delete';
```

### 6.5 å®‰å…¨çš„è§’è‰²ä¾èµ–ç®¡ç†


**ğŸ”’ ä¾èµ–ç®¡ç†æœ€ä½³å®è·µ**

```sql
-- âœ… å®‰å…¨åˆ é™¤è§’è‰²çš„æ­¥éª¤

-- 1. åˆ†æå½±å“èŒƒå›´
CALL analyze_role_impact('old_role');

-- 2. åˆ›å»ºæ›¿ä»£è§’è‰²
CREATE ROLE 'new_role';
GRANT required_permissions TO 'new_role';

-- 3. è¿ç§»ä¾èµ–å…³ç³»
UPDATE mysql.role_edges 
SET TO_USER = 'new_role' 
WHERE TO_USER = 'old_role';

-- 4. éªŒè¯æƒé™å®Œæ•´æ€§
CALL verify_role_permissions('new_role');

-- 5. å®‰å…¨åˆ é™¤æ—§è§’è‰²
DROP ROLE 'old_role';
```

---

## 7. ğŸ” ç»§æ‰¿é“¾æŸ¥è¯¢ä¸åˆ†æ


### 7.1 ç»§æ‰¿é“¾çš„æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šç»§æ‰¿é“¾å°±åƒå®¶æ—æ—è°±ï¼Œè®°å½•äº†æƒé™æ˜¯å¦‚ä½•ä»ç¥–å…ˆä¼ é€’åˆ°åä»£çš„å®Œæ•´è·¯å¾„ã€‚

```
ğŸ“ˆ ç»§æ‰¿é“¾ç¤ºä¾‹ï¼š
ç”¨æˆ·john â†’ è§’è‰²sales_manager â†’ è§’è‰²team_leader â†’ è§’è‰²employee â†’ åŸºç¡€æƒé™

æƒé™ä¼ é€’è·¯å¾„ï¼š
åŸºç¡€æƒé™ â†’ employee â†’ team_leader â†’ sales_manager â†’ johnç”¨æˆ·
```

### 7.2 ç»§æ‰¿é“¾æ·±åº¦æŸ¥è¯¢


```sql
-- ğŸ” æŸ¥è¯¢å®Œæ•´çš„ç»§æ‰¿é“¾è·¯å¾„
WITH RECURSIVE inheritance_chain AS (
  -- èµ·å§‹ç‚¹ï¼šç”¨æˆ·ç›´æ¥æ‹¥æœ‰çš„è§’è‰²
  SELECT 
    user as current_node,
    role as parent_node,
    0 as depth,
    CAST(CONCAT(user, ' -> ', role) AS CHAR(2000)) as chain_path
  FROM mysql.role_edges 
  WHERE user = 'john@localhost'
  
  UNION ALL
  
  -- é€’å½’ï¼šæŸ¥æ‰¾è§’è‰²çš„çˆ¶è§’è‰²
  SELECT 
    ic.current_node,
    re.TO_USER as parent_node,
    ic.depth + 1,
    CAST(CONCAT(ic.chain_path, ' -> ', re.TO_USER) AS CHAR(2000))
  FROM inheritance_chain ic
  JOIN mysql.role_edges re ON ic.parent_node = re.FROM_USER
  WHERE ic.depth < 8  -- é™åˆ¶æœ€å¤§æ·±åº¦
)
SELECT 
  current_node,
  parent_node,
  depth,
  chain_path
FROM inheritance_chain
ORDER BY depth, chain_path;
```

### 7.3 ç»§æ‰¿æ·±åº¦é™åˆ¶æ§åˆ¶


**ğŸš¨ æ·±åº¦é™åˆ¶çš„é‡è¦æ€§**
- **æ€§èƒ½ä¿æŠ¤**ï¼šé¿å…è¿‡æ·±é€’å½’æ¶ˆè€—èµ„æº
- **å¤æ‚åº¦æ§åˆ¶**ï¼šä¿æŒè§’è‰²ç»“æ„ç®€å•æ¸…æ™°  
- **å®‰å…¨è€ƒè™‘**ï¼šé˜²æ­¢æƒé™é“¾è¿‡é•¿éš¾ä»¥å®¡è®¡

```sql
-- ğŸ”§ è®¾ç½®å’Œæ£€æŸ¥ç»§æ‰¿æ·±åº¦é™åˆ¶

-- æ£€æŸ¥å½“å‰è§’è‰²çš„æœ€å¤§ç»§æ‰¿æ·±åº¦
SELECT 
  role_name,
  MAX(depth) as max_inheritance_depth
FROM (
  WITH RECURSIVE role_depth AS (
    SELECT FROM_USER as role_name, 0 as depth
    FROM mysql.role_edges
    WHERE TO_USER IS NULL  -- æ ¹è§’è‰²
    
    UNION ALL
    
    SELECT re.FROM_USER, rd.depth + 1
    FROM role_depth rd
    JOIN mysql.role_edges re ON rd.role_name = re.TO_USER
    WHERE rd.depth < 10
  )
  SELECT * FROM role_depth
) depth_calc
GROUP BY role_name
HAVING max_inheritance_depth > 5;  -- å‘ç°æ·±åº¦è¶…è¿‡5å±‚çš„è§’è‰²
```

### 7.4 ç»§æ‰¿é“¾æ€§èƒ½ä¼˜åŒ–


```sql
-- âš¡ ä¼˜åŒ–ç»§æ‰¿é“¾æŸ¥è¯¢æ€§èƒ½

-- åˆ›å»ºè§’è‰²å…³ç³»ç¼“å­˜è¡¨
CREATE TABLE role_inheritance_cache (
  child_role VARCHAR(255),
  ancestor_role VARCHAR(255),
  inheritance_depth INT,
  full_path TEXT,
  INDEX idx_child (child_role),
  INDEX idx_ancestor (ancestor_role),
  INDEX idx_depth (inheritance_depth)
);

-- å®šæœŸæ›´æ–°ç¼“å­˜(å¯ä»¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹å®ç°)
DELIMITER //
CREATE PROCEDURE refresh_inheritance_cache()
BEGIN
  TRUNCATE TABLE role_inheritance_cache;
  
  INSERT INTO role_inheritance_cache
  WITH RECURSIVE inheritance_tree AS (
    SELECT FROM_USER as child, TO_USER as ancestor, 1 as depth, 
           CONCAT(FROM_USER, '->', TO_USER) as path
    FROM mysql.role_edges
    
    UNION ALL
    
    SELECT it.child, re.TO_USER, it.depth + 1,
           CONCAT(it.path, '->', re.TO_USER)
    FROM inheritance_tree it
    JOIN mysql.role_edges re ON it.ancestor = re.FROM_USER
    WHERE it.depth < 8
  )
  SELECT child, ancestor, depth, path FROM inheritance_tree;
END //
DELIMITER ;
```

---

## 8. ğŸ”’ è§’è‰²ç»§æ‰¿å®‰å…¨æ§åˆ¶


### 8.1 ç»§æ‰¿å…³ç³»å®‰å…¨éªŒè¯


**ç®€å•ç†è§£**ï¼šå°±åƒæ£€æŸ¥å‘˜å·¥è¯ä»¶çš„çœŸä¼ªï¼Œéœ€è¦éªŒè¯è§’è‰²ç»§æ‰¿å…³ç³»æ˜¯å¦åˆæ³•ã€å®‰å…¨ã€ç¬¦åˆå…¬å¸è§„å®šã€‚

**ğŸ”¸ å®‰å…¨éªŒè¯è¦ç‚¹**
```
âœ… æƒé™è¾¹ç•Œæ£€æŸ¥ï¼šç¡®ä¿ç»§æ‰¿ä¸ä¼šè¶…å‡ºæƒé™èŒƒå›´
âœ… å¾ªç¯å¼•ç”¨æ£€æµ‹ï¼šé˜²æ­¢è§’è‰²å…³ç³»å½¢æˆç¯è·¯
âœ… æ·±åº¦é™åˆ¶éªŒè¯ï¼šæ§åˆ¶ç»§æ‰¿é“¾ä¸ä¼šè¿‡æ·±
âœ… æƒé™å†²çªæ£€æµ‹ï¼šå‘ç°çŸ›ç›¾çš„æƒé™è®¾ç½®
âœ… å®‰å…¨ç­–ç•¥åˆè§„ï¼šç¬¦åˆä¼ä¸šå®‰å…¨æ”¿ç­–
```

### 8.2 æƒé™è¾¹ç•Œå®‰å…¨æ£€æŸ¥


```sql
-- ğŸ” æ£€æŸ¥è§’è‰²ç»§æ‰¿æ˜¯å¦è¿åæƒé™è¾¹ç•Œ

-- åˆ›å»ºæƒé™è¾¹ç•Œæ£€æŸ¥å‡½æ•°
DELIMITER //
CREATE PROCEDURE check_permission_boundaries(IN target_role VARCHAR(255))
BEGIN
  DECLARE done INT DEFAULT FALSE;
  DECLARE role_name VARCHAR(255);
  DECLARE permission_level INT DEFAULT 0;
  
  -- æŸ¥è¯¢è§’è‰²çš„æœ€é«˜æƒé™çº§åˆ«
  SELECT MAX(
    CASE 
      WHEN privilege_type = 'ALL PRIVILEGES' THEN 10
      WHEN privilege_type = 'DELETE' THEN 8
      WHEN privilege_type = 'UPDATE' THEN 6
      WHEN privilege_type = 'INSERT' THEN 4
      WHEN privilege_type = 'SELECT' THEN 2
      ELSE 1
    END
  ) INTO permission_level
  FROM information_schema.role_table_grants
  WHERE grantee = CONCAT("'", target_role, "'");
  
  -- æ£€æŸ¥æ˜¯å¦è¶…å‡ºä¸šåŠ¡è§’è‰²æƒé™è¾¹ç•Œ
  IF permission_level > 6 AND target_role LIKE '%_user' THEN
    SELECT CONCAT('å®‰å…¨è­¦å‘Š: æ™®é€šç”¨æˆ·è§’è‰² ', target_role, ' æ‹¥æœ‰è¿‡é«˜æƒé™') as warning;
  END IF;
  
  -- æ£€æŸ¥æ˜¯å¦æœ‰è·¨éƒ¨é—¨æƒé™
  SELECT DISTINCT table_schema as cross_department_access
  FROM information_schema.role_table_grants  
  WHERE grantee = CONCAT("'", target_role, "'")
  AND table_schema NOT LIKE CONCAT('%', SUBSTRING_INDEX(target_role, '_', 1), '%');
END //
DELIMITER ;
```

### 8.3 ç»§æ‰¿å…³ç³»å®¡è®¡æœºåˆ¶


```sql
-- ğŸ“Š è§’è‰²ç»§æ‰¿å…³ç³»å®¡è®¡

-- åˆ›å»ºå®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE role_inheritance_audit (
  audit_id INT AUTO_INCREMENT PRIMARY KEY,
  audit_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  operation_type ENUM('GRANT', 'REVOKE', 'CREATE', 'DROP'),
  child_role VARCHAR(255),
  parent_role VARCHAR(255),
  operator_user VARCHAR(255),
  risk_level ENUM('LOW', 'MEDIUM', 'HIGH'),
  audit_result TEXT
);

-- åˆ›å»ºå®¡è®¡è§¦å‘å™¨(æ¦‚å¿µç¤ºä¾‹ï¼Œå®é™…éœ€è¦åœ¨åº”ç”¨å±‚å®ç°)
DELIMITER //
CREATE PROCEDURE audit_role_inheritance(
  IN op_type VARCHAR(10),
  IN child_role VARCHAR(255), 
  IN parent_role VARCHAR(255),
  IN operator VARCHAR(255)
)
BEGIN
  DECLARE risk_level VARCHAR(10) DEFAULT 'LOW';
  DECLARE audit_msg TEXT DEFAULT '';
  
  -- è¯„ä¼°é£é™©çº§åˆ«
  IF parent_role IN ('root', 'admin', 'super_admin') THEN
    SET risk_level = 'HIGH';
    SET audit_msg = 'é«˜é£é™©ï¼šç»§æ‰¿äº†è¶…çº§ç®¡ç†å‘˜æƒé™';
  ELSEIF (SELECT COUNT(*) FROM mysql.role_edges WHERE TO_USER = parent_role) > 5 THEN
    SET risk_level = 'MEDIUM';  
    SET audit_msg = 'ä¸­é£é™©ï¼šçˆ¶è§’è‰²æƒé™è¿‡äºå¤æ‚';
  END IF;
  
  -- è®°å½•å®¡è®¡æ—¥å¿—
  INSERT INTO role_inheritance_audit 
  (operation_type, child_role, parent_role, operator_user, risk_level, audit_result)
  VALUES (op_type, child_role, parent_role, operator, risk_level, audit_msg);
END //
DELIMITER ;
```

### 8.4 è§’è‰²æƒé™å˜æ›´ç›‘æ§


```sql
-- ğŸš¨ å®æ—¶ç›‘æ§è§’è‰²æƒé™å˜æ›´

-- åˆ›å»ºæƒé™å˜æ›´ç›‘æ§è§†å›¾
CREATE VIEW role_permission_changes AS
SELECT 
  rta.GRANTEE as role_name,
  rta.TABLE_SCHEMA as database_name,
  rta.PRIVILEGE_TYPE as permission,
  'CURRENT' as change_type,
  NOW() as change_time
FROM information_schema.ROLE_TABLE_GRANTS rta;

-- æ£€æŸ¥å¼‚å¸¸æƒé™æˆäºˆ
SELECT 
  role_name,
  database_name,
  permission,
  'å¼‚å¸¸ï¼šæ™®é€šè§’è‰²è·å¾—ç®¡ç†æƒé™' as alert_message
FROM role_permission_changes
WHERE role_name LIKE '%user%' 
  AND permission IN ('DELETE', 'DROP', 'ALTER', 'CREATE');

-- æ£€æŸ¥è·¨éƒ¨é—¨æ•°æ®è®¿é—®
SELECT 
  role_name,
  database_name,
  'å¼‚å¸¸ï¼šè·¨éƒ¨é—¨æ•°æ®è®¿é—®' as alert_message
FROM role_permission_changes  
WHERE (role_name LIKE '%finance%' AND database_name LIKE '%hr%')
   OR (role_name LIKE '%hr%' AND database_name LIKE '%finance%');
```

### 8.5 åº”æ€¥å“åº”æœºåˆ¶


```sql
-- ğŸ†˜ è§’è‰²ç»§æ‰¿å®‰å…¨åº”æ€¥å“åº”

-- ç´§æ€¥æ’¤é”€è§’è‰²æƒé™
DELIMITER //
CREATE PROCEDURE emergency_revoke_role(IN target_role VARCHAR(255))
BEGIN
  DECLARE done INT DEFAULT FALSE;
  DECLARE affected_user VARCHAR(255);
  DECLARE user_cursor CURSOR FOR 
    SELECT DISTINCT grantee FROM information_schema.applicable_roles 
    WHERE role_name = target_role;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
  
  -- è®°å½•åº”æ€¥æ“ä½œ
  INSERT INTO role_inheritance_audit 
  (operation_type, child_role, parent_role, operator_user, risk_level, audit_result)
  VALUES ('EMERGENCY_REVOKE', target_role, 'N/A', USER(), 'HIGH', 
          CONCAT('ç´§æ€¥æ’¤é”€è§’è‰²æƒé™: ', target_role));
  
  -- æ’¤é”€æ‰€æœ‰ç”¨æˆ·çš„æ­¤è§’è‰²
  OPEN user_cursor;
  read_loop: LOOP
    FETCH user_cursor INTO affected_user;
    IF done THEN LEAVE read_loop; END IF;
    
    SET @sql = CONCAT('REVOKE `', target_role, '` FROM ', affected_user);
    PREPARE stmt FROM @sql;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
  END LOOP;
  CLOSE user_cursor;
  
  SELECT CONCAT('å·²ç´§æ€¥æ’¤é”€è§’è‰² ', target_role, ' çš„æ‰€æœ‰æƒé™') as result;
END //
DELIMITER ;
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è§’è‰²ç»§æ‰¿æœ¬è´¨ï¼šæƒé™çš„å±‚çº§ä¼ é€’æœºåˆ¶ï¼Œå­è§’è‰²è‡ªåŠ¨è·å¾—çˆ¶è§’è‰²æƒé™
ğŸ”¸ ç»§æ‰¿å…³ç³»å»ºç«‹ï¼šä½¿ç”¨GRANT role TO roleè¯­æ³•å»ºç«‹çˆ¶å­å…³ç³»
ğŸ”¸ æƒé™è®¡ç®—è§„åˆ™ï¼šæœ€ç»ˆæƒé™ = ç›´æ¥æƒé™ + æ‰€æœ‰ç»§æ‰¿æƒé™çš„å¹¶é›†
ğŸ”¸ å¾ªç¯å¼•ç”¨é˜²æŠ¤ï¼šMySQLè‡ªåŠ¨æ£€æµ‹å¹¶é˜»æ­¢è§’è‰²ç»§æ‰¿å½¢æˆç¯è·¯
ğŸ”¸ ç»§æ‰¿é“¾ç®¡ç†ï¼šé€šè¿‡é€’å½’æŸ¥è¯¢åˆ†æå¤šçº§ç»§æ‰¿å…³ç³»
ğŸ”¸ å®‰å…¨æ§åˆ¶æœºåˆ¶ï¼šæƒé™è¾¹ç•Œæ£€æŸ¥ã€å®¡è®¡ç›‘æ§ã€åº”æ€¥å“åº”
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è§’è‰²ç»§æ‰¿çš„è®¾è®¡æ€è·¯**
```
åˆ†å±‚æƒé™ç®¡ç†ï¼š
- åŸºç¡€æƒé™ â†’ ä¸“ä¸šæƒé™ â†’ ç®¡ç†æƒé™ â†’ è¶…çº§æƒé™
- æ¯å±‚æƒé™é€æ­¥æ‰©å¤§ï¼Œå½¢æˆé‡‘å­—å¡”ç»“æ„
- ç®€åŒ–æƒé™ç®¡ç†ï¼Œé¿å…é‡å¤æˆæƒ

æƒé™ä¼ é€’åŸç†ï¼š
- å­è§’è‰²ç»§æ‰¿çˆ¶è§’è‰²çš„æ‰€æœ‰æƒé™
- æƒé™åªèƒ½å‘ä¸‹ä¼ é€’ï¼Œä¸èƒ½å‘ä¸Šå½±å“
- æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œæƒé™å–å¹¶é›†
```

**ğŸ”¹ å®é™…åº”ç”¨çš„æ³¨æ„äº‹é¡¹**
```
è®¾è®¡åŸåˆ™ï¼š
âœ… å±‚æ¬¡æ¸…æ™°ï¼šæ¯å±‚è§’è‰²èŒè´£æ˜ç¡®
âœ… æœ€å°æƒé™ï¼šåªç»™å¿…éœ€çš„æƒé™
âœ… ä¾¿äºç»´æŠ¤ï¼šé¿å…è¿‡äºå¤æ‚çš„ç»§æ‰¿å…³ç³»

å¸¸è§é—®é¢˜ï¼š
âŒ ç»§æ‰¿è¿‡æ·±ï¼šéš¾ä»¥ç†è§£å’Œç»´æŠ¤
âŒ æƒé™å†—ä½™ï¼šå¤šä¸ªè§’è‰²æœ‰ç›¸åŒæƒé™
âŒ ç¼ºä¹ç›‘æ§ï¼šæƒé™å˜æ›´æ— è®°å½•
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ è§’è‰²ç»§æ‰¿æœ€ä½³å®è·µ**

```sql
-- âœ… æ¨èçš„è§’è‰²å±‚æ¬¡ç»“æ„
-- ç¬¬1å±‚ï¼šåŸºç¡€åŠŸèƒ½è§’è‰²
CREATE ROLE 'read_only', 'data_entry', 'report_viewer';

-- ç¬¬2å±‚ï¼šä¸šåŠ¡è§’è‰²(ç»„åˆåŸºç¡€è§’è‰²)
CREATE ROLE 'sales_user', 'finance_user', 'hr_user';
GRANT 'read_only', 'data_entry' TO 'sales_user';

-- ç¬¬3å±‚ï¼šç®¡ç†è§’è‰²
CREATE ROLE 'dept_manager'; 
GRANT 'sales_user', 'report_viewer' TO 'dept_manager';

-- ç¬¬4å±‚ï¼šç³»ç»Ÿç®¡ç†
CREATE ROLE 'system_admin';
GRANT 'dept_manager' TO 'system_admin';
```

**ğŸ”§ ç»´æŠ¤ç®¡ç†å»ºè®®**

```sql
-- å®šæœŸæ£€æŸ¥è§’è‰²ç»§æ‰¿å¥åº·åº¦
-- 1. æ£€æŸ¥ç»§æ‰¿æ·±åº¦
-- 2. æ£€æŸ¥æƒé™åˆç†æ€§  
-- 3. æ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨
-- 4. å®¡è®¡æƒé™å˜æ›´è®°å½•

-- ç¤ºä¾‹å¥åº·æ£€æŸ¥æŸ¥è¯¢
SELECT 
  COUNT(*) as total_roles,
  MAX(inheritance_depth) as max_depth,
  AVG(inheritance_depth) as avg_depth
FROM role_inheritance_cache;
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è§’è‰²ç»§æ‰¿æƒé™ä¼ ï¼Œçˆ¶çº§æƒé™å­æ‰¿æ‹…
å±‚æ¬¡æ¸…æ™°æ˜“ç®¡ç†ï¼Œå¾ªç¯å¼•ç”¨è¦é˜²èŒƒ  
æ·±åº¦æ§åˆ¶ä¸è¿‡æ·±ï¼Œå®‰å…¨å®¡è®¡å¸¸æ£€éªŒ
æœ€å°æƒé™æ˜¯åŸåˆ™ï¼Œåº”æ€¥å“åº”ä¿å®‰å…¨
```

### 9.4 å­¦ä¹ è·¯å¾„å»ºè®®


```
ğŸš€ å­¦ä¹ è¿›é˜¶è·¯å¾„ï¼š
1. æŒæ¡åŸºæœ¬è§’è‰²åˆ›å»ºå’Œæƒé™æˆäºˆ
2. ç†è§£è§’è‰²ç»§æ‰¿çš„è¯­æ³•å’Œæœºåˆ¶  
3. å­¦ä¼šè®¾è®¡åˆç†çš„è§’è‰²å±‚æ¬¡ç»“æ„
4. æŒæ¡ç»§æ‰¿å…³ç³»æŸ¥è¯¢å’Œåˆ†ææ–¹æ³•
5. å»ºç«‹å®‰å…¨æ§åˆ¶å’Œç›‘æ§æœºåˆ¶
6. å®è·µå¤æ‚åœºæ™¯çš„è§’è‰²æƒé™ç®¡ç†

ğŸ’¡ å®è·µå»ºè®®ï¼š
- ä»ç®€å•çš„3å±‚è§’è‰²ç»“æ„å¼€å§‹ç»ƒä¹ 
- é€æ­¥å¢åŠ å¤æ‚åº¦ï¼Œä½“éªŒä¸åŒè®¾è®¡çš„ä¼˜ç¼ºç‚¹
- é‡ç‚¹å…³æ³¨å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§
- å»ºç«‹å®Œæ•´çš„å®¡è®¡å’Œç›‘æ§ä½“ç³»
```