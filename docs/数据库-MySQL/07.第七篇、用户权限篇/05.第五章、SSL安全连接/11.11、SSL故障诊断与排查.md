---
title: 11ã€SSLæ•…éšœè¯Šæ–­ä¸æ’æŸ¥
---
## ğŸ“š ç›®å½•

1. [SSLæ•…éšœæ¦‚è¿°](#1-SSLæ•…éšœæ¦‚è¿°)
2. [SSLæ¡æ‰‹å¤±è´¥åˆ†æ](#2-SSLæ¡æ‰‹å¤±è´¥åˆ†æ)
3. [è¯ä¹¦é“¾éªŒè¯é—®é¢˜](#3-è¯ä¹¦é“¾éªŒè¯é—®é¢˜)
4. [SSLé…ç½®é”™è¯¯æ’æŸ¥](#4-SSLé…ç½®é”™è¯¯æ’æŸ¥)
5. [å®¢æˆ·ç«¯å…¼å®¹æ€§é—®é¢˜](#5-å®¢æˆ·ç«¯å…¼å®¹æ€§é—®é¢˜)
6. [SSLæ€§èƒ½é—®é¢˜è¯Šæ–­](#6-SSLæ€§èƒ½é—®é¢˜è¯Šæ–­)
7. [æ•…éšœå®šä½å·¥å…·](#7-æ•…éšœå®šä½å·¥å…·)
8. [SSLæ•…éšœè‡ªåŠ¨è¯Šæ–­](#8-SSLæ•…éšœè‡ªåŠ¨è¯Šæ–­)
9. [SSLæ•…éšœå®‰å…¨æ’æŸ¥](#9-SSLæ•…éšœå®‰å…¨æ’æŸ¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” SSLæ•…éšœæ¦‚è¿°


SSLæ•…éšœæ˜¯MySQLåŠ å¯†è¿æ¥ä¸­æœ€å¸¸è§çš„é—®é¢˜ï¼Œé€šå¸¸è¡¨ç°ä¸ºè¿æ¥å¤±è´¥ã€æ€§èƒ½ä¸‹é™æˆ–å®‰å…¨è­¦å‘Šã€‚ç†è§£SSLæ•…éšœçš„æ ¹æœ¬åŸå› æ˜¯å¿«é€Ÿæ’æŸ¥çš„å…³é”®ã€‚

### 1.1 å¸¸è§SSLæ•…éšœç±»å‹


**è¿æ¥çº§æ•…éšœï¼š**
```
ğŸ”´ æ¡æ‰‹å¤±è´¥ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ— æ³•åå•†åŠ å¯†å‚æ•°
ğŸ”´ è¯ä¹¦é”™è¯¯ï¼šè¯ä¹¦æ— æ•ˆã€è¿‡æœŸæˆ–ä¸å—ä¿¡ä»»
ğŸ”´ åè®®ä¸åŒ¹é…ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ”¯æŒçš„SSLç‰ˆæœ¬ä¸å…¼å®¹
ğŸ”´ é…ç½®é”™è¯¯ï¼šæœåŠ¡å™¨SSLé…ç½®ä¸æ­£ç¡®
```

**æ€§èƒ½ç±»æ•…éšœï¼š**
```
ğŸŸ¡ è¿æ¥ç¼“æ…¢ï¼šSSLæ¡æ‰‹è€—æ—¶è¿‡é•¿
ğŸŸ¡ ååé‡ä¸‹é™ï¼šåŠ å¯†è§£å¯†å¼€é”€è¿‡å¤§
ğŸŸ¡ CPUå ç”¨é«˜ï¼šSSLå¤„ç†æ¶ˆè€—å¤§é‡CPUèµ„æº
```

### 1.2 æ•…éšœå½±å“èŒƒå›´


```
åº”ç”¨å±‚å½±å“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨ç¨‹åºè¿æ¥å¤±è´¥        â”‚ â† æœ€ç›´æ¥çš„å½±å“
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®ä¼ è¾“ä¸­æ–­           â”‚ â† ä¸šåŠ¡ä¸­æ–­
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ€§èƒ½æ˜¾è‘—ä¸‹é™           â”‚ â† ç”¨æˆ·ä½“éªŒå·®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç³»ç»Ÿå±‚å½±å“ï¼š
â€¢ æ•°æ®åº“è¿æ¥æ± è€—å°½
â€¢ æœåŠ¡å™¨èµ„æºå ç”¨å¼‚å¸¸
â€¢ ç›‘æ§å‘Šè­¦é¢‘ç¹è§¦å‘
```

---

## 2. ğŸ¤ SSLæ¡æ‰‹å¤±è´¥åˆ†æ


SSLæ¡æ‰‹æ˜¯å»ºç«‹å®‰å…¨è¿æ¥çš„ç¬¬ä¸€æ­¥ï¼Œæ¡æ‰‹å¤±è´¥æ˜¯æœ€å¸¸è§çš„SSLæ•…éšœã€‚

### 2.1 æ¡æ‰‹è¿‡ç¨‹è¯¦è§£


**SSLæ¡æ‰‹æ­¥éª¤ï¼š**
```
å®¢æˆ·ç«¯                    MySQLæœåŠ¡å™¨
   |                           |
   |--[1] Client Hello-------->|
   |    (æ”¯æŒçš„SSLç‰ˆæœ¬å’Œç®—æ³•)    |
   |                           |
   |<---[2] Server Hello-------|
   |    (é€‰æ‹©çš„SSLç‰ˆæœ¬å’Œç®—æ³•)    |
   |                           |
   |<---[3] Certificate--------|
   |    (æœåŠ¡å™¨è¯ä¹¦)           |
   |                           |
   |--[4] Key Exchange-------->|
   |    (å¯†é’¥äº¤æ¢)             |
   |                           |
   |--[5] Finished------------>|
   |<---[6] Finished-----------|
   |    (æ¡æ‰‹å®Œæˆ)             |
```

### 2.2 æ¡æ‰‹å¤±è´¥åŸå› åˆ†æ


**ğŸ”¸ åè®®ç‰ˆæœ¬ä¸åŒ¹é…**
```sql
-- æ£€æŸ¥æœåŠ¡å™¨æ”¯æŒçš„SSLç‰ˆæœ¬
SHOW VARIABLES LIKE 'tls_version';

-- å¸¸è§é”™è¯¯ç¤ºä¾‹
ERROR 2026 (HY000): SSL connection error: 
protocol version mismatch
```

**ğŸ”¸ åŠ å¯†ç®—æ³•ä¸æ”¯æŒ**
```sql
-- æ£€æŸ¥æ”¯æŒçš„åŠ å¯†å¥—ä»¶
SHOW STATUS LIKE 'Ssl_cipher%';

-- å®¢æˆ·ç«¯æŒ‡å®šç‰¹å®šåŠ å¯†ç®—æ³•
mysql --ssl-cipher=AES128-SHA --ssl-mode=REQUIRED
```

### 2.3 æ¡æ‰‹å¤±è´¥æ’æŸ¥æ­¥éª¤


**æ­¥éª¤1ï¼šæ£€æŸ¥SSLåŸºç¡€é…ç½®**
```sql
-- éªŒè¯SSLæ˜¯å¦å¯ç”¨
SHOW VARIABLES LIKE 'have_ssl';
-- ç»“æœåº”è¯¥æ˜¯ YES

-- æ£€æŸ¥SSLç›¸å…³é…ç½®
SHOW VARIABLES LIKE 'ssl%';
```

**æ­¥éª¤2ï¼šæµ‹è¯•SSLè¿æ¥**
```bash
# ä½¿ç”¨opensslæµ‹è¯•SSLæ¡æ‰‹
openssl s_client -connect localhost:3306 -servername mysql

# ä½¿ç”¨mysqlå®¢æˆ·ç«¯æµ‹è¯•
mysql --ssl-mode=REQUIRED --ssl-ca=ca.pem -h localhost -u user -p
```

---

## 3. ğŸ“œ è¯ä¹¦é“¾éªŒè¯é—®é¢˜


è¯ä¹¦é—®é¢˜æ˜¯SSLæ•…éšœçš„ä¸»è¦åŸå› ä¹‹ä¸€ï¼ŒåŒ…æ‹¬è¯ä¹¦è¿‡æœŸã€è¯ä¹¦é“¾ä¸å®Œæ•´ã€è¯ä¹¦ä¸å—ä¿¡ä»»ç­‰ã€‚

### 3.1 è¯ä¹¦éªŒè¯è¿‡ç¨‹


**è¯ä¹¦é“¾éªŒè¯æµç¨‹ï¼š**
```
æ ¹è¯ä¹¦(Root CA)
    â†“ ç­¾åéªŒè¯
ä¸­é—´è¯ä¹¦(Intermediate CA)
    â†“ ç­¾åéªŒè¯  
æœåŠ¡å™¨è¯ä¹¦(Server Certificate)
    â†“ åŸŸåéªŒè¯
å®¢æˆ·ç«¯éªŒè¯é€šè¿‡
```

### 3.2 å¸¸è§è¯ä¹¦é—®é¢˜


**ğŸ”¸ è¯ä¹¦è¿‡æœŸ**
```sql
-- æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
SHOW STATUS LIKE 'Ssl_server_not%';

-- æŸ¥çœ‹è¯ä¹¦è¯¦ç»†ä¿¡æ¯
SELECT * FROM performance_schema.tls_channel_status;
```

**ğŸ”¸ è¯ä¹¦é“¾ä¸å®Œæ•´**
```bash
# æ£€æŸ¥è¯ä¹¦é“¾å®Œæ•´æ€§
openssl verify -CAfile ca.pem -untrusted intermediate.pem server.pem

# æ˜¾ç¤ºè¯ä¹¦é“¾ä¿¡æ¯
openssl s_client -connect localhost:3306 -showcerts
```

### 3.3 è¯ä¹¦é—®é¢˜æ’æŸ¥


**æ£€æŸ¥è¯ä¹¦æ–‡ä»¶ï¼š**
```bash
# éªŒè¯è¯ä¹¦æ ¼å¼
openssl x509 -in server.pem -text -noout

# æ£€æŸ¥ç§é’¥åŒ¹é…
openssl rsa -in server-key.pem -check

# éªŒè¯è¯ä¹¦å’Œç§é’¥æ˜¯å¦åŒ¹é…
openssl x509 -noout -modulus -in server.pem | openssl md5
openssl rsa -noout -modulus -in server-key.pem | openssl md5
```

**MySQLè¯ä¹¦é…ç½®éªŒè¯ï¼š**
```sql
-- æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„è¯ä¹¦ä¿¡æ¯
SHOW STATUS LIKE 'Ssl_server_cert%';

-- æ£€æŸ¥è¯ä¹¦ä¸»é¢˜ä¿¡æ¯
SELECT variable_value FROM performance_schema.session_status 
WHERE variable_name = 'Ssl_server_cert_subject';
```

---

## 4. âš™ï¸ SSLé…ç½®é”™è¯¯æ’æŸ¥


SSLé…ç½®é”™è¯¯æ˜¯å¯¼è‡´è¿æ¥å¤±è´¥çš„å¸¸è§åŸå› ï¼Œéœ€è¦ç³»ç»Ÿæ€§åœ°æ£€æŸ¥å„é¡¹é…ç½®å‚æ•°ã€‚

### 4.1 æœåŠ¡å™¨ç«¯é…ç½®æ£€æŸ¥


**åŸºæœ¬SSLé…ç½®ï¼š**
```ini
# my.cnf é…ç½®ç¤ºä¾‹
[mysqld]
ssl-ca = /etc/mysql/ssl/ca.pem
ssl-cert = /etc/mysql/ssl/server-cert.pem  
ssl-key = /etc/mysql/ssl/server-key.pem
ssl-cipher = AES128-GCM-SHA256:AES256-GCM-SHA384
tls-version = TLSv1.2,TLSv1.3
```

**é…ç½®éªŒè¯å‘½ä»¤ï¼š**
```sql
-- æ£€æŸ¥SSLæ–‡ä»¶è·¯å¾„
SHOW VARIABLES LIKE 'ssl_%';

-- éªŒè¯TLSç‰ˆæœ¬é…ç½®
SHOW VARIABLES LIKE 'tls_version';

-- æ£€æŸ¥åŠ å¯†å¥—ä»¶
SHOW VARIABLES LIKE 'ssl_cipher';
```

### 4.2 æ–‡ä»¶æƒé™é—®é¢˜


**ğŸ”¸ è¯ä¹¦æ–‡ä»¶æƒé™æ£€æŸ¥**
```bash
# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶æƒé™(åº”è¯¥æ˜¯644)
ls -la /etc/mysql/ssl/ca.pem
ls -la /etc/mysql/ssl/server-cert.pem

# æ£€æŸ¥ç§é’¥æ–‡ä»¶æƒé™(åº”è¯¥æ˜¯600)  
ls -la /etc/mysql/ssl/server-key.pem

# ä¿®æ­£æƒé™
chmod 644 /etc/mysql/ssl/*.pem
chmod 600 /etc/mysql/ssl/server-key.pem
chown mysql:mysql /etc/mysql/ssl/*
```

### 4.3 é…ç½®åŠ è½½éªŒè¯


**é‡å¯åé…ç½®æ£€æŸ¥ï¼š**
```sql
-- éªŒè¯SSLçŠ¶æ€
SELECT * FROM performance_schema.session_status 
WHERE variable_name IN ('Ssl_version', 'Ssl_cipher');

-- æ£€æŸ¥SSLè¿æ¥ç»Ÿè®¡
SHOW STATUS LIKE 'Ssl_accepts';
SHOW STATUS LIKE 'Ssl_finished_accepts';
```

---

## 5. ğŸ–¥ï¸ å®¢æˆ·ç«¯å…¼å®¹æ€§é—®é¢˜


ä¸åŒçš„MySQLå®¢æˆ·ç«¯å¯¹SSLçš„æ”¯æŒç¨‹åº¦ä¸åŒï¼Œå¯èƒ½å¯¼è‡´å…¼å®¹æ€§é—®é¢˜ã€‚

### 5.1 å®¢æˆ·ç«¯SSLæ¨¡å¼


**SSLè¿æ¥æ¨¡å¼è¯´æ˜ï¼š**
```
DISABLEDï¼šç¦ç”¨SSLè¿æ¥
PREFERREDï¼šä¼˜å…ˆSSLï¼Œå¤±è´¥æ—¶é™çº§ä¸ºéSSL  
REQUIREDï¼šå¿…é¡»SSLï¼Œå¤±è´¥æ—¶ä¸è¿æ¥
VERIFY_CAï¼šéªŒè¯CAè¯ä¹¦
VERIFY_IDENTITYï¼šéªŒè¯æœåŠ¡å™¨èº«ä»½
```

### 5.2 ä¸åŒå®¢æˆ·ç«¯çš„SSLé…ç½®


**ğŸ”¸ MySQLå‘½ä»¤è¡Œå®¢æˆ·ç«¯**
```bash
# å¼ºåˆ¶SSLè¿æ¥
mysql --ssl-mode=REQUIRED -h hostname -u username -p

# æŒ‡å®šè¯ä¹¦æ–‡ä»¶
mysql --ssl-ca=ca.pem --ssl-cert=client-cert.pem \
      --ssl-key=client-key.pem -h hostname -u username -p

# å¿½ç•¥è¯ä¹¦éªŒè¯(æµ‹è¯•ç”¨)
mysql --ssl-mode=REQUIRED --ssl-verify-server-cert=false
```

**ğŸ”¸ åº”ç”¨ç¨‹åºè¿æ¥å­—ç¬¦ä¸²**
```java
// JDBCè¿æ¥å­—ç¬¦ä¸²
String url = "jdbc:mysql://localhost:3306/mydb" +
             "?useSSL=true&requireSSL=true" +
             "&verifyServerCertificate=true" +
             "&trustCertificateKeyStoreUrl=file:keystore.jks";

// Python MySQLdb
connection = MySQLdb.connect(
    host='localhost',
    user='username', 
    passwd='password',
    ssl={'ca': 'ca.pem', 'cert': 'client-cert.pem', 'key': 'client-key.pem'}
)
```

### 5.3 å…¼å®¹æ€§é—®é¢˜æ’æŸ¥


**ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥ï¼š**
```sql
-- æ£€æŸ¥å®¢æˆ·ç«¯SSLèƒ½åŠ›
SELECT * FROM information_schema.session_status 
WHERE variable_name LIKE 'Ssl_client%';

-- æŸ¥çœ‹å½“å‰è¿æ¥çš„SSLä¿¡æ¯
SHOW STATUS LIKE 'Ssl_cipher';
SHOW STATUS LIKE 'Ssl_version';
```

---

## 6. âš¡ SSLæ€§èƒ½é—®é¢˜è¯Šæ–­


SSLåŠ å¯†ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼Œéœ€è¦ç›‘æ§å’Œä¼˜åŒ–SSLæ€§èƒ½ã€‚

### 6.1 SSLæ€§èƒ½æŒ‡æ ‡


**å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼š**
```sql
-- SSLæ¡æ‰‹ç»Ÿè®¡
SHOW STATUS LIKE 'Ssl_accepts';           -- SSLè¿æ¥æ¥å—æ•°
SHOW STATUS LIKE 'Ssl_finished_accepts';  -- æˆåŠŸå®Œæˆçš„SSLæ¡æ‰‹
SHOW STATUS LIKE 'Ssl_accept_renegotiates'; -- SSLé‡æ–°åå•†æ¬¡æ•°

-- SSLä¼šè¯é‡ç”¨
SHOW STATUS LIKE 'Ssl_session_cache%';    -- SSLä¼šè¯ç¼“å­˜ç»Ÿè®¡
```

### 6.2 æ€§èƒ½ç“¶é¢ˆè¯†åˆ«


**ğŸ”¸ CPUä½¿ç”¨ç‡ç›‘æ§**
```bash
# ç›‘æ§MySQLè¿›ç¨‹CPUä½¿ç”¨
top -p $(pidof mysqld)

# æŸ¥çœ‹SSLç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨
strace -p $(pidof mysqld) -e trace=read,write,poll -f
```

**ğŸ”¸ è¿æ¥æ—¶é—´åˆ†æ**
```sql
-- å¼€å¯æ€§èƒ½æ¨¡å¼ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET enabled='YES' WHERE name LIKE '%ssl%';

-- æŸ¥çœ‹SSLç›¸å…³äº‹ä»¶
SELECT * FROM performance_schema.events_waits_current 
WHERE event_name LIKE '%ssl%';
```

### 6.3 SSLæ€§èƒ½ä¼˜åŒ–


**é…ç½®ä¼˜åŒ–ï¼š**
```ini
# my.cnf SSLæ€§èƒ½ä¼˜åŒ–
[mysqld]
# å¯ç”¨SSLä¼šè¯é‡ç”¨
ssl-session-timeout = 28800

# é€‰æ‹©é«˜æ€§èƒ½åŠ å¯†ç®—æ³•
ssl-cipher = ECDHE-RSA-AES128-GCM-SHA256

# é™åˆ¶TLSç‰ˆæœ¬æé«˜æ€§èƒ½
tls-version = TLSv1.3
```

**ç¡¬ä»¶åŠ é€Ÿï¼š**
```bash
# æ£€æŸ¥æ˜¯å¦æ”¯æŒç¡¬ä»¶åŠ é€Ÿ
openssl engine -t

# æŸ¥çœ‹CPUæ˜¯å¦æ”¯æŒAES-NI
grep -m1 -o aes /proc/cpuinfo
```

---

## 7. ğŸ› ï¸ æ•…éšœå®šä½å·¥å…·


ä½¿ç”¨ä¸“ä¸šå·¥å…·å¯ä»¥å¿«é€Ÿå®šä½SSLæ•…éšœæ ¹å› ã€‚

### 7.1 ç½‘ç»œæŠ“åŒ…åˆ†æ


**ğŸ”¸ ä½¿ç”¨tcpdumpæŠ“åŒ…**
```bash
# æŠ“å–MySQL SSLæµé‡
sudo tcpdump -i any -A -s 0 'port 3306' -w mysql_ssl.pcap

# å®æ—¶æŸ¥çœ‹SSLæ¡æ‰‹
sudo tcpdump -i any -X 'port 3306 and tcp[tcpflags] & tcp-syn != 0'
```

**ğŸ”¸ ä½¿ç”¨Wiresharkåˆ†æ**
```
SSLæ¡æ‰‹åˆ†æè¦ç‚¹ï¼š
1. Client Hello - æ£€æŸ¥æ”¯æŒçš„SSLç‰ˆæœ¬å’ŒåŠ å¯†å¥—ä»¶
2. Server Hello - ç¡®è®¤é€‰æ‹©çš„åŠ å¯†å‚æ•°  
3. Certificate - éªŒè¯è¯ä¹¦é“¾
4. Key Exchange - æ£€æŸ¥å¯†é’¥äº¤æ¢è¿‡ç¨‹
5. Application Data - ç¡®è®¤åŠ å¯†é€šä¿¡æ­£å¸¸
```

### 7.2 SSLä¸“ç”¨å·¥å…·


**ğŸ”¸ nmap SSLæ£€æµ‹**
```bash
# æ£€æµ‹SSLé…ç½®
nmap --script ssl-enum-ciphers -p 3306 localhost

# æ£€æŸ¥SSLè¯ä¹¦
nmap --script ssl-cert -p 3306 localhost

# æ£€æµ‹SSLæ¼æ´
nmap --script ssl-* -p 3306 localhost
```

**ğŸ”¸ testssl.sh å·¥å…·**
```bash
# ä¸‹è½½å¹¶è¿è¡Œtestssl.sh
git clone https://github.com/drwetter/testssl.sh.git
cd testssl.sh
./testssl.sh localhost:3306
```

### 7.3 MySQLå†…ç½®è¯Šæ–­


**ğŸ”¸ é”™è¯¯æ—¥å¿—åˆ†æ**
```bash
# æŸ¥çœ‹SSLç›¸å…³é”™è¯¯
grep -i ssl /var/log/mysql/error.log
grep -i tls /var/log/mysql/error.log

# å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿—
tail -f /var/log/mysql/error.log | grep -i ssl
```

**ğŸ”¸ æ€§èƒ½ç›‘æ§æŸ¥è¯¢**
```sql
-- æŸ¥çœ‹SSLè¿æ¥çŠ¶æ€åˆ†å¸ƒ
SELECT 
  if(variable_name='Ssl_cipher', 'SSL', 'Non-SSL') as connection_type,
  COUNT(*) as count
FROM performance_schema.session_status s
JOIN performance_schema.threads t ON s.thread_id = t.thread_id
WHERE t.type = 'FOREGROUND'
GROUP BY connection_type;
```

---

## 8. ğŸ¤– SSLæ•…éšœè‡ªåŠ¨è¯Šæ–­


å»ºç«‹è‡ªåŠ¨åŒ–è¯Šæ–­æœºåˆ¶å¯ä»¥å¿«é€Ÿå‘ç°å’Œå¤„ç†SSLæ•…éšœã€‚

### 8.1 è‡ªåŠ¨è¯Šæ–­è„šæœ¬


**ğŸ”¸ SSLå¥åº·æ£€æŸ¥è„šæœ¬**
```bash
#!/bin/bash
# ssl_health_check.sh

check_ssl_status() {
    local host=$1
    local port=${2:-3306}
    
    echo "=== MySQL SSL Health Check ==="
    
    # æ£€æŸ¥SSLè¿æ¥
    timeout 5 mysql -h $host -P $port --ssl-mode=REQUIRED \
                    -e "SHOW STATUS LIKE 'Ssl_cipher';" 2>/dev/null
    
    if [ $? -eq 0 ]; then
        echo "âœ… SSL connection successful"
    else
        echo "âŒ SSL connection failed"
        return 1
    fi
    
    # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
    cert_info=$(openssl s_client -connect $host:$port </dev/null 2>/dev/null | 
                openssl x509 -noout -dates 2>/dev/null)
    
    if [ $? -eq 0 ]; then
        echo "âœ… Certificate accessible"
        echo "$cert_info"
    else
        echo "âŒ Certificate check failed"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
check_ssl_status localhost 3306
```

### 8.2 ç›‘æ§å‘Šè­¦é…ç½®


**ğŸ”¸ Zabbixç›‘æ§é¡¹**
```sql
-- åˆ›å»ºSSLç›‘æ§è§†å›¾
CREATE VIEW ssl_monitor AS
SELECT 
    'ssl_connections' as metric,
    variable_value as value
FROM performance_schema.global_status 
WHERE variable_name = 'Ssl_accepts'
UNION ALL
SELECT 
    'ssl_errors' as metric,
    variable_value as value  
FROM performance_schema.global_status
WHERE variable_name = 'Ssl_finished_accepts';
```

**ğŸ”¸ PrometheusæŒ‡æ ‡å¯¼å‡º**
```yaml
# mysql_exporteré…ç½®
- name: mysql_ssl_status
  query: |
    SELECT 
      'mysql_ssl_accepts' as metric_name,
      variable_value as metric_value
    FROM performance_schema.global_status 
    WHERE variable_name = 'Ssl_accepts';
```

### 8.3 æ•…éšœè‡ªåŠ¨ä¿®å¤


**ğŸ”¸ è¯ä¹¦è‡ªåŠ¨æ›´æ–°è„šæœ¬**
```bash
#!/bin/bash
# auto_cert_renewal.sh

renew_certificate() {
    local cert_path="/etc/mysql/ssl/server-cert.pem"
    local days_before_expiry=30
    
    # æ£€æŸ¥è¯ä¹¦è¿‡æœŸæ—¶é—´
    expiry_date=$(openssl x509 -in $cert_path -noout -enddate | cut -d= -f2)
    expiry_timestamp=$(date -d "$expiry_date" +%s)
    current_timestamp=$(date +%s)
    days_until_expiry=$(( (expiry_timestamp - current_timestamp) / 86400 ))
    
    if [ $days_until_expiry -lt $days_before_expiry ]; then
        echo "Certificate expires in $days_until_expiry days, renewing..."
        # æ‰§è¡Œè¯ä¹¦æ›´æ–°é€»è¾‘
        /path/to/cert_renewal_script.sh
        
        # é‡æ–°åŠ è½½MySQLé…ç½®
        mysqladmin -u root -p flush-ssl
    fi
}
```

---

## 9. ğŸ”’ SSLæ•…éšœå®‰å…¨æ’æŸ¥


åœ¨æ’æŸ¥SSLæ•…éšœæ—¶å¿…é¡»æ³¨æ„å®‰å…¨æ€§ï¼Œé¿å…å¼•å…¥æ–°çš„å®‰å…¨é£é™©ã€‚

### 9.1 å®‰å…¨æ’æŸ¥åŸåˆ™


**ğŸ”¸ æœ€å°æƒé™åŸåˆ™**
```
æ’æŸ¥æƒé™æ§åˆ¶ï¼š
â€¢ åªæˆäºˆå¿…è¦çš„è¯Šæ–­æƒé™
â€¢ ä½¿ç”¨ä¸“ç”¨çš„è¯Šæ–­è´¦æˆ·
â€¢ é™åˆ¶æ•æ„Ÿä¿¡æ¯çš„è®¿é—®
â€¢ åŠæ—¶å›æ”¶ä¸´æ—¶æƒé™
```

**ğŸ”¸ æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**
```sql
-- åˆ›å»ºä¸“ç”¨è¯Šæ–­ç”¨æˆ·
CREATE USER 'ssl_diag'@'localhost' 
IDENTIFIED BY 'strong_password';

-- æˆäºˆæœ€å°å¿…è¦æƒé™
GRANT PROCESS, SELECT ON performance_schema.* TO 'ssl_diag'@'localhost';
GRANT SELECT ON information_schema.* TO 'ssl_diag'@'localhost';
```

### 9.2 æ’æŸ¥è¿‡ç¨‹å®‰å…¨æ§åˆ¶


**ğŸ”¸ æµ‹è¯•ç¯å¢ƒéš”ç¦»**
```bash
# åœ¨æµ‹è¯•ç¯å¢ƒè¿›è¡ŒSSLé…ç½®æµ‹è¯•
# é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥ä¿®æ”¹SSLé…ç½®

# ä½¿ç”¨é…ç½®æ–‡ä»¶å‰¯æœ¬æµ‹è¯•
cp /etc/mysql/my.cnf /etc/mysql/my.cnf.test
# ä¿®æ”¹æµ‹è¯•é…ç½®æ–‡ä»¶
# åœ¨æµ‹è¯•å®ä¾‹ä¸ŠéªŒè¯é…ç½®
```

**ğŸ”¸ æ—¥å¿—å®‰å…¨å¤„ç†**
```bash
# æ¸…ç†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ—¥å¿—
sed -i 's/password=\w*/password=****/g' diagnostic.log

# é™åˆ¶æ—¥å¿—æ–‡ä»¶æƒé™
chmod 600 /tmp/ssl_diagnostic.log
chown mysql:mysql /tmp/ssl_diagnostic.log
```

### 9.3 åº”æ€¥å¤„ç†å®‰å…¨æªæ–½


**ğŸ”¸ SSLæ•…éšœåº”æ€¥é¢„æ¡ˆ**
```sql
-- ç´§æ€¥æƒ…å†µä¸‹ä¸´æ—¶ç¦ç”¨SSLè¦æ±‚
UPDATE mysql.user SET ssl_type = '' WHERE ssl_type = 'ANY';
FLUSH PRIVILEGES;

-- è®°å½•å®‰å…¨äº‹ä»¶
INSERT INTO security_audit_log (event_type, description, timestamp)
VALUES ('SSL_EMERGENCY_DISABLE', 'SSL temporarily disabled for troubleshooting', NOW());
```

**ğŸ”¸ æ¢å¤åå®‰å…¨éªŒè¯**
```sql
-- SSLæ¢å¤åçš„å®‰å…¨æ£€æŸ¥
SELECT user, host, ssl_type, ssl_cipher 
FROM mysql.user 
WHERE ssl_type != '';

-- éªŒè¯å½“å‰SSLè¿æ¥
SELECT * FROM performance_schema.session_status 
WHERE variable_name IN ('Ssl_cipher', 'Ssl_version')
AND thread_id = CONNECTION_ID();
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ•…éšœç±»å‹


```
ğŸ”´ SSLæ¡æ‰‹å¤±è´¥ï¼š
â€¢ åè®®ç‰ˆæœ¬ä¸åŒ¹é… â†’ æ£€æŸ¥tls_versioné…ç½®
â€¢ åŠ å¯†ç®—æ³•ä¸æ”¯æŒ â†’ éªŒè¯ssl_cipheré…ç½®  
â€¢ è¯ä¹¦é—®é¢˜ â†’ æ£€æŸ¥è¯ä¹¦æ–‡ä»¶å’Œæƒé™

ğŸŸ¡ æ€§èƒ½é—®é¢˜ï¼š
â€¢ SSLæ¡æ‰‹ç¼“æ…¢ â†’ å¯ç”¨ä¼šè¯é‡ç”¨
â€¢ CPUå ç”¨è¿‡é«˜ â†’ é€‰æ‹©é«˜æ•ˆåŠ å¯†ç®—æ³•
â€¢ å†…å­˜ä½¿ç”¨å¼‚å¸¸ â†’ ç›‘æ§SSLç¼“å­˜å¤§å°

ğŸŸ¢ é…ç½®é”™è¯¯ï¼š
â€¢ æ–‡ä»¶è·¯å¾„é”™è¯¯ â†’ éªŒè¯ssl_ca/cert/keyè·¯å¾„
â€¢ æƒé™é—®é¢˜ â†’ æ£€æŸ¥æ–‡ä»¶æ‰€æœ‰æƒå’Œæƒé™
â€¢ å‚æ•°å†²çª â†’ å®¡æŸ¥my.cnfé…ç½®é¡¹
```

### 10.2 å…³é”®æ’æŸ¥æµç¨‹


```
æ•…éšœæ’æŸ¥æ­¥éª¤ï¼š
1ï¸âƒ£ åŸºç¡€æ£€æŸ¥ â†’ SSLçŠ¶æ€ã€é…ç½®ã€æ–‡ä»¶æƒé™
2ï¸âƒ£ è¿æ¥æµ‹è¯• â†’ ä½¿ç”¨mysqlå®¢æˆ·ç«¯å’Œopensslå·¥å…·
3ï¸âƒ£ è¯ä¹¦éªŒè¯ â†’ æ£€æŸ¥è¯ä¹¦é“¾å®Œæ•´æ€§å’Œæœ‰æ•ˆæœŸ
4ï¸âƒ£ ç½‘ç»œåˆ†æ â†’ tcpdumpæŠ“åŒ…åˆ†æSSLæ¡æ‰‹
5ï¸âƒ£ æ€§èƒ½è¯Šæ–­ â†’ ç›‘æ§CPUã€å†…å­˜ã€è¿æ¥æ—¶é—´
6ï¸âƒ£ å®‰å…¨æ£€æŸ¥ â†’ ç¡®ä¿æ’æŸ¥è¿‡ç¨‹ä¸å¼•å…¥é£é™©
```

### 10.3 å®ç”¨è¯Šæ–­å‘½ä»¤


**å¿«é€Ÿæ£€æŸ¥å‘½ä»¤ï¼š**
```sql
-- SSLçŠ¶æ€ä¸€é”®æ£€æŸ¥
SELECT 
  $$have_ssl as ssl_available,
  $$ssl_ca as ca_file,
  $$ssl_cert as cert_file,
  $$ssl_key as key_file,
  $$tls_version as tls_versions;

-- å½“å‰è¿æ¥SSLä¿¡æ¯
SHOW STATUS LIKE 'Ssl%';
```

**æ€§èƒ½ç›‘æ§å‘½ä»¤ï¼š**
```sql
-- SSLæ€§èƒ½ç»Ÿè®¡
SELECT 
  variable_name,
  variable_value,
  CASE variable_name
    WHEN 'Ssl_accepts' THEN 'Total SSL connections attempted'
    WHEN 'Ssl_finished_accepts' THEN 'Successful SSL handshakes'
    WHEN 'Ssl_session_cache_hits' THEN 'SSL session cache hits'
    WHEN 'Ssl_session_cache_misses' THEN 'SSL session cache misses'
  END as description
FROM performance_schema.global_status 
WHERE variable_name IN ('Ssl_accepts', 'Ssl_finished_accepts', 
                        'Ssl_session_cache_hits', 'Ssl_session_cache_misses');
```

### 10.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ é¢„é˜²æ€§æªæ–½ï¼š**
- å®šæœŸç›‘æ§è¯ä¹¦æœ‰æ•ˆæœŸï¼Œæå‰30å¤©æ›´æ–°
- å»ºç«‹SSLæ€§èƒ½åŸºçº¿ï¼Œè®¾ç½®å‘Šè­¦é˜ˆå€¼
- ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·ç¡®ä¿é…ç½®ä¸€è‡´æ€§
- å®šæœŸè¿›è¡ŒSSLå®‰å…¨æ‰«æå’Œæ¼æ´æ£€æµ‹

**ğŸ”§ æ•…éšœå¤„ç†åŸåˆ™ï¼š**
- å…ˆåœ¨æµ‹è¯•ç¯å¢ƒå¤ç°é—®é¢˜å†ä¿®å¤
- ä¿ç•™è¯¦ç»†çš„æ•…éšœæ’æŸ¥æ—¥å¿—
- ä¿®å¤åè¿›è¡Œå……åˆ†çš„å›å½’æµ‹è¯•
- å»ºç«‹æ•…éšœçŸ¥è¯†åº“ç§¯ç´¯ç»éªŒ

**ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹ï¼š**
- æ’æŸ¥è¿‡ç¨‹ä¸­ä¿æŠ¤æ•æ„Ÿä¿¡æ¯
- ä½¿ç”¨æœ€å°æƒé™åŸåˆ™è¿›è¡Œè¯Šæ–­
- åŠæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—
- è®°å½•æ‰€æœ‰å®‰å…¨ç›¸å…³çš„æ“ä½œ

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
- SSLæ•…éšœçœ‹ä¸‰ç‚¹ï¼šæ¡æ‰‹ã€è¯ä¹¦ã€é…ç½®å…¨
- å·¥å…·åŠ©åŠ›å¿«è¯Šæ–­ï¼šæŠ“åŒ…ã€å‘½ä»¤ã€è‡ªåŠ¨åŒ–  
- å®‰å…¨æ’æŸ¥å®ˆåº•çº¿ï¼šæƒé™æœ€å°ã€ä¿¡æ¯ä¿æŠ¤
- é¢„é˜²èƒœè¿‡åæ²»ç†ï¼šç›‘æ§å‘Šè­¦ã€å®šæœŸæ£€æŸ¥