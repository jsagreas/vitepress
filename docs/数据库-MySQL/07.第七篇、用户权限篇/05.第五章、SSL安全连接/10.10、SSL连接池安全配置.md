---
title: 10ã€SSLè¿æ¥æ± å®‰å…¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [SSLè¿æ¥æ± åŸºç¡€æ¦‚å¿µ](#1-sslè¿æ¥æ± åŸºç¡€æ¦‚å¿µ)
2. [è¿æ¥æ± SSLé…ç½®è¯¦è§£](#2-è¿æ¥æ± sslé…ç½®è¯¦è§£)
3. [SSLè¿æ¥å¤ç”¨æœºåˆ¶](#3-sslè¿æ¥å¤ç”¨æœºåˆ¶)
4. [SSLæ¡æ‰‹æ€§èƒ½ä¼˜åŒ–](#4-sslæ¡æ‰‹æ€§èƒ½ä¼˜åŒ–)
5. [è¿æ¥æ± å®‰å…¨éªŒè¯](#5-è¿æ¥æ± å®‰å…¨éªŒè¯)
6. [SSLè¿æ¥æ± ç›‘æ§](#6-sslè¿æ¥æ± ç›‘æ§)
7. [å®‰å…¨ç­–ç•¥ä¸æœ€ä½³å®è·µ](#7-å®‰å…¨ç­–ç•¥ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” SSLè¿æ¥æ± åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SSLè¿æ¥æ± 


**SSLè¿æ¥æ± **å°±æ˜¯æŠŠ**å¸¦æœ‰SSLåŠ å¯†çš„æ•°æ®åº“è¿æ¥**é›†ä¸­ç®¡ç†èµ·æ¥ï¼Œå°±åƒåœè½¦åœºç®¡ç†è½¦ä½ä¸€æ ·ã€‚

```
æ™®é€šè¿æ¥æ± ï¼š              SSLè¿æ¥æ± ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿æ¥1       â”‚         â”‚ SSLè¿æ¥1    â”‚ ğŸ”’
â”‚ è¿æ¥2       â”‚   â†’     â”‚ SSLè¿æ¥2    â”‚ ğŸ”’  
â”‚ è¿æ¥3       â”‚         â”‚ SSLè¿æ¥3    â”‚ ğŸ”’
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     å¿«ä½†ä¸å®‰å…¨              æ…¢ä½†å¾ˆå®‰å…¨
```

**ğŸ”¸ æ ¸å¿ƒç‰¹ç‚¹**
- **å®‰å…¨æ€§**ï¼šæ‰€æœ‰æ•°æ®ä¼ è¾“éƒ½ç»è¿‡SSLåŠ å¯†
- **å¤ç”¨æ€§**ï¼šSSLè¿æ¥å¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨
- **æ€§èƒ½æƒè¡¡**ï¼šSSLæ¡æ‰‹è€—æ—¶ï¼Œä½†è¿æ¥æ± å‡å°‘äº†æ¡æ‰‹æ¬¡æ•°

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦SSLè¿æ¥æ± 


**ä¼ ç»Ÿé—®é¢˜**ï¼šæ¯æ¬¡éƒ½å»ºç«‹æ–°çš„SSLè¿æ¥
```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ å»ºç«‹TCPè¿æ¥ â†’ SSLæ¡æ‰‹ â†’ æ•°æ®ä¼ è¾“ â†’ å…³é—­è¿æ¥
  â†“
è€—æ—¶ï¼š50ms + 200ms + 10ms + 50ms = 310ms
```

**è¿æ¥æ± è§£å†³æ–¹æ¡ˆ**ï¼š
```
é¦–æ¬¡ï¼šå®¢æˆ·ç«¯ â†’ SSLæ¡æ‰‹ â†’ æ”¾å…¥è¿æ¥æ± 
åç»­ï¼šå®¢æˆ·ç«¯ â†’ ç›´æ¥ä»æ± ä¸­å–è¿æ¥ â†’ æ•°æ®ä¼ è¾“
  â†“
è€—æ—¶ï¼š5ms + 10ms = 15msï¼ˆçœäº†245msï¼ï¼‰
```

### 1.3 SSLè¿æ¥æ± çš„å·¥ä½œåŸç†


```
åº”ç”¨ç¨‹åºå±‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          è¿æ¥æ± ç®¡ç†å™¨                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚SSL1 â”‚ â”‚SSL2 â”‚ â”‚SSL3 â”‚ â”‚ ... â”‚   â”‚ ğŸ”’ åŠ å¯†è¿æ¥
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“ SSLåŠ å¯†é€šé“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            MySQLæœåŠ¡å™¨              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âš™ï¸ è¿æ¥æ± SSLé…ç½®è¯¦è§£


### 2.1 åŸºç¡€SSLè¿æ¥æ± é…ç½®


**HikariCPé…ç½®ç¤ºä¾‹**ï¼ˆJavaæœ€æµè¡Œçš„è¿æ¥æ± ï¼‰ï¼š
```properties
# åŸºç¡€è¿æ¥é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/mydb?useSSL=true
spring.datasource.username=myuser
spring.datasource.password=mypass

# SSLå®‰å…¨é…ç½®
spring.datasource.hikari.dataSourceProperties.useSSL=true
spring.datasource.hikari.dataSourceProperties.requireSSL=true
spring.datasource.hikari.dataSourceProperties.verifyServerCertificate=true

# è¿æ¥æ± å¤§å°é…ç½®
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
```

### 2.2 SSLè¯ä¹¦é…ç½®å‚æ•°


**ğŸ”¸ å…³é”®SSLå‚æ•°è¯¦è§£**ï¼š

| å‚æ•°å | **ä½œç”¨** | **æ¨èå€¼** | **è¯´æ˜** |
|--------|----------|------------|----------|
| `useSSL` | `å¼€å¯SSLè¿æ¥` | `true` | `å¿…é¡»å¼€å¯æ‰èƒ½ä½¿ç”¨SSL` |
| `requireSSL` | `å¼ºåˆ¶ä½¿ç”¨SSL` | `true` | `æ‹’ç»éSSLè¿æ¥ï¼Œæé«˜å®‰å…¨æ€§` |
| `verifyServerCertificate` | `éªŒè¯æœåŠ¡å™¨è¯ä¹¦` | `true` | `é˜²æ­¢ä¸­é—´äººæ”»å‡»` |
| `trustCertificateKeyStoreUrl` | `ä¿¡ä»»è¯ä¹¦åº“è·¯å¾„` | `classpath:truststore.jks` | `å­˜æ”¾å¯ä¿¡ä»»çš„è¯ä¹¦` |
| `clientCertificateKeyStoreUrl` | `å®¢æˆ·ç«¯è¯ä¹¦è·¯å¾„` | `classpath:client.p12` | `åŒå‘è®¤è¯æ—¶ä½¿ç”¨` |

### 2.3 ä¸åŒè¿æ¥æ± çš„SSLé…ç½®


**Druidè¿æ¥æ± é…ç½®**ï¼š
```properties
spring.datasource.druid.url=jdbc:mysql://localhost:3306/mydb?useSSL=true&requireSSL=true
spring.datasource.druid.connection-properties.useSSL=true
spring.datasource.druid.connection-properties.trustCertificateKeyStoreUrl=classpath:truststore.jks
spring.datasource.druid.connection-properties.trustCertificateKeyStorePassword=changeit

# è¿æ¥æ± å‚æ•°
spring.datasource.druid.initial-size=5
spring.datasource.druid.max-active=20
spring.datasource.druid.min-idle=5
```

**C3P0è¿æ¥æ± é…ç½®**ï¼š
```java
ComboPooledDataSource dataSource = new ComboPooledDataSource();
dataSource.setJdbcUrl("jdbc:mysql://localhost:3306/mydb?useSSL=true&requireSSL=true");
dataSource.setUser("myuser");
dataSource.setPassword("mypass");

// SSLç›¸å…³å±æ€§
Properties props = new Properties();
props.setProperty("useSSL", "true");
props.setProperty("requireSSL", "true");
props.setProperty("verifyServerCertificate", "true");
dataSource.setProperties(props);

// è¿æ¥æ± è®¾ç½®
dataSource.setMaxPoolSize(20);
dataSource.setMinPoolSize(5);
dataSource.setAcquireIncrement(2);
```

---

## 3. ğŸ”„ SSLè¿æ¥å¤ç”¨æœºåˆ¶


### 3.1 SSLè¿æ¥å¤ç”¨åŸç†


**ä¼ ç»Ÿæ¨¡å¼**ï¼ˆæ¯æ¬¡æ–°å»ºï¼‰ï¼š
```
è¯·æ±‚1: åº”ç”¨ â†’ å»ºç«‹TCP â†’ SSLæ¡æ‰‹ â†’ æŸ¥è¯¢ â†’ å…³é—­è¿æ¥
è¯·æ±‚2: åº”ç”¨ â†’ å»ºç«‹TCP â†’ SSLæ¡æ‰‹ â†’ æŸ¥è¯¢ â†’ å…³é—­è¿æ¥
è¯·æ±‚3: åº”ç”¨ â†’ å»ºç«‹TCP â†’ SSLæ¡æ‰‹ â†’ æŸ¥è¯¢ â†’ å…³é—­è¿æ¥
```

**è¿æ¥æ± å¤ç”¨æ¨¡å¼**ï¼š
```
åˆå§‹åŒ–: åº”ç”¨ â†’ é¢„å»ºSSLè¿æ¥æ± (5ä¸ªè¿æ¥)

è¯·æ±‚1: åº”ç”¨ â†’ ä»æ± ä¸­å–è¿æ¥ â†’ æŸ¥è¯¢ â†’ è¿”å›æ± ä¸­
è¯·æ±‚2: åº”ç”¨ â†’ ä»æ± ä¸­å–è¿æ¥ â†’ æŸ¥è¯¢ â†’ è¿”å›æ± ä¸­  
è¯·æ±‚3: åº”ç”¨ â†’ ä»æ± ä¸­å–è¿æ¥ â†’ æŸ¥è¯¢ â†’ è¿”å›æ± ä¸­
```

### 3.2 è¿æ¥å¤ç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†


**ğŸ”¸ è¿æ¥çŠ¶æ€è½¬æ¢**ï¼š
```
ç©ºé—²è¿æ¥æ±      â†’    ä½¿ç”¨ä¸­    â†’    éªŒè¯æ£€æŸ¥    â†’    è¿”å›æ± ä¸­
   â†“                               â†“
è¿‡æœŸè¿æ¥    â†’    é”€æ¯é‡å»º    â†    éªŒè¯å¤±è´¥
```

**è¿æ¥éªŒè¯é…ç½®**ï¼š
```properties
# è¿æ¥æœ‰æ•ˆæ€§æ£€æŸ¥
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.validation-timeout=3000

# è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†
spring.datasource.hikari.max-lifetime=600000    # 10åˆ†é’Ÿæœ€å¤§å­˜æ´»æ—¶é—´
spring.datasource.hikari.idle-timeout=300000    # 5åˆ†é’Ÿç©ºé—²è¶…æ—¶
spring.datasource.hikari.leak-detection-threshold=60000  # 1åˆ†é’Ÿæ³„éœ²æ£€æµ‹
```

### 3.3 SSLä¼šè¯å¤ç”¨ä¼˜åŒ–


**MySQL SSLä¼šè¯å¤ç”¨è®¾ç½®**ï¼š
```sql
-- æŸ¥çœ‹SSLä¼šè¯å¤ç”¨çŠ¶æ€
SHOW STATUS LIKE 'Ssl_session%';

-- è®¾ç½®SSLä¼šè¯ç¼“å­˜å¤§å°
SET GLOBAL ssl_session_cache_size = 1024;

-- è®¾ç½®SSLä¼šè¯è¶…æ—¶æ—¶é—´
SET GLOBAL ssl_session_cache_timeout = 3600;
```

**åº”ç”¨ç«¯SSLä¼šè¯é…ç½®**ï¼š
```properties
# å¯ç”¨SSLä¼šè¯å¤ç”¨
spring.datasource.hikari.dataSourceProperties.useSSLSessionReuse=true
spring.datasource.hikari.dataSourceProperties.sslSessionCacheSize=1024
spring.datasource.hikari.dataSourceProperties.sslSessionTimeout=3600
```

---

## 4. âš¡ SSLæ¡æ‰‹æ€§èƒ½ä¼˜åŒ–


### 4.1 SSLæ¡æ‰‹è¿‡ç¨‹åˆ†æ


**SSLæ¡æ‰‹çš„4ä¸ªæ­¥éª¤**ï¼š
```
å®¢æˆ·ç«¯                           MySQLæœåŠ¡å™¨
  â”‚                                 â”‚
  â”‚â”€â”€ [1] Client Hello â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  å‘é€æ”¯æŒçš„åŠ å¯†ç®—æ³•
  â”‚                                 â”‚
  â”‚â†â”€â”€â”€â”€ [2] Server Hello â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  é€‰æ‹©åŠ å¯†ç®—æ³•+è¯ä¹¦
  â”‚                                 â”‚
  â”‚â”€â”€ [3] Client Key Exchange â”€â”€â”€â”€â”€â†’â”‚  å‘é€é¢„ä¸»å¯†é’¥
  â”‚                                 â”‚
  â”‚â†â”€ [4] Change Cipher Spec â”€â”€â”€â”€â”€â”€â”€â”‚  ç¡®è®¤å¼€å§‹åŠ å¯†é€šä¿¡
  â”‚                                 â”‚
  â•°â•â•â•â•â•â•â• åŠ å¯†é€šä¿¡å¼€å§‹ â•â•â•â•â•â•â•â•â•â•â•â•¯
```

### 4.2 æ¡æ‰‹æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ å‡å°‘æ¡æ‰‹æ¬¡æ•°**ï¼š
```properties
# å¢åŠ è¿æ¥æ± æœ€å°è¿æ¥æ•°ï¼Œå‡å°‘åŠ¨æ€åˆ›å»º
spring.datasource.hikari.minimum-idle=10

# å»¶é•¿è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼Œå‡å°‘é‡å»º
spring.datasource.hikari.max-lifetime=1800000  # 30åˆ†é’Ÿ

# å¯ç”¨è¿æ¥é¢„çƒ­
spring.datasource.hikari.initialization-fail-timeout=1
```

**ğŸ”¸ ä¼˜åŒ–SSLç®—æ³•é€‰æ‹©**ï¼š
```properties
# ä½¿ç”¨æ›´å¿«çš„åŠ å¯†ç®—æ³•
spring.datasource.hikari.dataSourceProperties.enabledSSLCipherSuites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384

# æŒ‡å®šSSLåè®®ç‰ˆæœ¬
spring.datasource.hikari.dataSourceProperties.sslMode=REQUIRED
spring.datasource.hikari.dataSourceProperties.tlsVersions=TLSv1.2,TLSv1.3
```

### 4.3 MySQLæœåŠ¡å™¨ç«¯SSLä¼˜åŒ–


**æœåŠ¡å™¨SSLé…ç½®ä¼˜åŒ–**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰SSLé…ç½®
SHOW VARIABLES LIKE 'ssl%';

-- ä¼˜åŒ–SSLç¼“å­˜
SET GLOBAL ssl_session_cache_mode = 'SERVER';
SET GLOBAL ssl_session_cache_size = 2048;

-- å¯ç”¨SSLå‹ç¼©ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
SET GLOBAL ssl_compress = ON;
```

**MySQLé…ç½®æ–‡ä»¶ä¼˜åŒ–**ï¼š
```ini
[mysqld]
# SSLæ€§èƒ½ä¼˜åŒ–
ssl_session_cache_size = 2048
ssl_session_cache_timeout = 7200

# ä½¿ç”¨é«˜æ€§èƒ½SSLç®—æ³•
ssl_cipher = ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384

# å¯ç”¨SSLä¼šè¯ç¥¨æ®
ssl_session_tickets = ON
```

---

## 5. ğŸ›¡ï¸ è¿æ¥æ± å®‰å…¨éªŒè¯


### 5.1 SSLè¯ä¹¦éªŒè¯é…ç½®


**å®Œæ•´çš„è¯ä¹¦éªŒè¯è®¾ç½®**ï¼š
```properties
# å¼€å¯ä¸¥æ ¼çš„è¯ä¹¦éªŒè¯
spring.datasource.hikari.dataSourceProperties.verifyServerCertificate=true
spring.datasource.hikari.dataSourceProperties.useSSL=true
spring.datasource.hikari.dataSourceProperties.requireSSL=true

# æŒ‡å®šä¿¡ä»»çš„è¯ä¹¦åº“
spring.datasource.hikari.dataSourceProperties.trustCertificateKeyStoreUrl=classpath:mysql-truststore.jks
spring.datasource.hikari.dataSourceProperties.trustCertificateKeyStorePassword=changeit
spring.datasource.hikari.dataSourceProperties.trustCertificateKeyStoreType=JKS
```

### 5.2 åŒå‘SSLè®¤è¯é…ç½®


**æœåŠ¡å™¨ç«¯éœ€è¦éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦**ï¼š
```properties
# å®¢æˆ·ç«¯è¯ä¹¦é…ç½®
spring.datasource.hikari.dataSourceProperties.clientCertificateKeyStoreUrl=classpath:client-keystore.p12
spring.datasource.hikari.dataSourceProperties.clientCertificateKeyStorePassword=clientpass
spring.datasource.hikari.dataSourceProperties.clientCertificateKeyStoreType=PKCS12

# å¼ºåˆ¶åŒå‘è®¤è¯
spring.datasource.hikari.dataSourceProperties.sslMode=VERIFY_IDENTITY
```

**MySQLæœåŠ¡å™¨åŒå‘è®¤è¯é…ç½®**ï¼š
```sql
-- è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦
SET GLOBAL require_secure_transport = ON;

-- æ£€æŸ¥SSLè¿æ¥çŠ¶æ€
SELECT 
    CONNECTION_ID(),
    SSL_GET_VERSION(),
    SSL_GET_CIPHER(),
    SSL_GET_VERIFY_RESULT()
FROM INFORMATION_SCHEMA.PROCESSLIST 
WHERE ID = CONNECTION_ID();
```

### 5.3 è¿æ¥å®‰å…¨æ€§ç›‘æ§


**è¿æ¥å®‰å…¨çŠ¶æ€æ£€æŸ¥**ï¼š
```java
@Component
public class SSLConnectionMonitor {
    
    @Autowired
    private DataSource dataSource;
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void checkSSLConnections() {
        try (Connection conn = dataSource.getConnection()) {
            // æ£€æŸ¥æ˜¯å¦ä¸ºSSLè¿æ¥
            boolean isSSL = checkSSLStatus(conn);
            
            // è·å–SSLç‰ˆæœ¬å’ŒåŠ å¯†å¥—ä»¶
            String sslInfo = getSSLInfo(conn);
            
            log.info("SSLè¿æ¥çŠ¶æ€: {}, è¯¦æƒ…: {}", isSSL, sslInfo);
        }
    }
    
    private boolean checkSSLStatus(Connection conn) throws SQLException {
        try (Statement stmt = conn.createStatement()) {
            ResultSet rs = stmt.executeQuery("SHOW STATUS LIKE 'Ssl_cipher'");
            return rs.next() && !rs.getString(2).isEmpty();
        }
    }
}
```

---

## 6. ğŸ“Š SSLè¿æ¥æ± ç›‘æ§


### 6.1 è¿æ¥æ± æ€§èƒ½ç›‘æ§æŒ‡æ ‡


**ğŸ”¸ æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ç±»å‹ | **ç›‘æ§é¡¹ç›®** | **æ­£å¸¸èŒƒå›´** | **å¼‚å¸¸å¤„ç†** |
|----------|-------------|-------------|-------------|
| **è¿æ¥æ•°** | `æ´»è·ƒè¿æ¥æ•°` | `< æœ€å¤§è¿æ¥æ•°80%` | `æ‰©å®¹æˆ–ä¼˜åŒ–æŸ¥è¯¢` |
| **æ€§èƒ½** | `SSLæ¡æ‰‹å»¶è¿Ÿ` | `< 200ms` | `ä¼˜åŒ–SSLé…ç½®` |
| **å®‰å…¨** | `SSLç‰ˆæœ¬åˆ†å¸ƒ` | `TLS 1.2+å æ¯”100%` | `ç¦ç”¨æ—§ç‰ˆæœ¬SSL` |
| **ç¨³å®šæ€§** | `è¿æ¥åˆ›å»ºå¤±è´¥ç‡` | `< 1%` | `æ£€æŸ¥ç½‘ç»œå’Œè¯ä¹¦` |

### 6.2 ç›‘æ§é…ç½®å®ç°


**HikariCPç›‘æ§é…ç½®**ï¼š
```properties
# å¼€å¯JMXç›‘æ§
spring.datasource.hikari.register-mbeans=true

# å¼€å¯è¿æ¥æ± æŒ‡æ ‡æ”¶é›†
management.endpoints.web.exposure.include=health,metrics,hikaricp
management.metrics.enable.hikaricp=true

# è‡ªå®šä¹‰è¿æ¥æ± åç§°ä¾¿äºç›‘æ§
spring.datasource.hikari.pool-name=MySQL-SSL-Pool
```

**MicrometeræŒ‡æ ‡æ”¶é›†**ï¼š
```java
@Component
public class SSLPoolMetrics {
    
    private final Counter sslHandshakeCounter;
    private final Timer sslConnectionTimer;
    
    public SSLPoolMetrics(MeterRegistry meterRegistry) {
        this.sslHandshakeCounter = Counter.builder("ssl.handshake.total")
            .description("SSLæ¡æ‰‹æ¬¡æ•°ç»Ÿè®¡")
            .register(meterRegistry);
            
        this.sslConnectionTimer = Timer.builder("ssl.connection.duration")
            .description("SSLè¿æ¥å»ºç«‹è€—æ—¶")
            .register(meterRegistry);
    }
    
    @EventListener
    public void onSSLHandshake(SSLHandshakeEvent event) {
        sslHandshakeCounter.increment();
        sslConnectionTimer.record(event.getDuration(), TimeUnit.MILLISECONDS);
    }
}
```

### 6.3 SSLè¿æ¥æ± å¥åº·æ£€æŸ¥


**å¥åº·æ£€æŸ¥å®ç°**ï¼š
```java
@Component
public class SSLPoolHealthIndicator implements HealthIndicator {
    
    @Autowired
    private DataSource dataSource;
    
    @Override
    public Health health() {
        try {
            // æ£€æŸ¥è¿æ¥æ± çŠ¶æ€
            HikariDataSource hikari = (HikariDataSource) dataSource;
            HikariPoolMXBean poolBean = hikari.getHikariPoolMXBean();
            
            int activeConnections = poolBean.getActiveConnections();
            int maxPoolSize = hikari.getMaximumPoolSize();
            
            // æ£€æŸ¥SSLè¿æ¥
            boolean sslWorking = testSSLConnection();
            
            if (sslWorking && activeConnections < maxPoolSize * 0.9) {
                return Health.up()
                    .withDetail("activeConnections", activeConnections)
                    .withDetail("maxPoolSize", maxPoolSize)
                    .withDetail("sslStatus", "healthy")
                    .build();
            } else {
                return Health.down()
                    .withDetail("activeConnections", activeConnections)
                    .withDetail("maxPoolSize", maxPoolSize)
                    .withDetail("sslStatus", sslWorking ? "healthy" : "failed")
                    .build();
            }
        } catch (Exception e) {
            return Health.down(e).build();
        }
    }
    
    private boolean testSSLConnection() {
        try (Connection conn = dataSource.getConnection();
             Statement stmt = conn.createStatement()) {
            ResultSet rs = stmt.executeQuery("SELECT SSL_GET_VERSION()");
            return rs.next() && rs.getString(1) != null;
        } catch (Exception e) {
            return false;
        }
    }
}
```

---

## 7. ğŸ”’ å®‰å…¨ç­–ç•¥ä¸æœ€ä½³å®è·µ


### 7.1 SSLè¿æ¥æ± å®‰å…¨ç­–ç•¥


**ğŸ”¸ å®‰å…¨é…ç½®æ¸…å•**ï¼š
```properties
# 1. å¼ºåˆ¶SSLè¿æ¥
spring.datasource.hikari.dataSourceProperties.useSSL=true
spring.datasource.hikari.dataSourceProperties.requireSSL=true

# 2. ç¦ç”¨ä¸å®‰å…¨çš„SSLç‰ˆæœ¬
spring.datasource.hikari.dataSourceProperties.enabledSSLProtocols=TLSv1.2,TLSv1.3

# 3. ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•
spring.datasource.hikari.dataSourceProperties.enabledSSLCipherSuites=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384

# 4. ä¸¥æ ¼è¯ä¹¦éªŒè¯
spring.datasource.hikari.dataSourceProperties.verifyServerCertificate=true
spring.datasource.hikari.dataSourceProperties.sslMode=VERIFY_IDENTITY

# 5. è¿æ¥è¶…æ—¶ä¿æŠ¤
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.validation-timeout=5000
```

### 7.2 è¯ä¹¦ç®¡ç†æœ€ä½³å®è·µ


**è¯ä¹¦å®‰å…¨ç®¡ç†**ï¼š
```bash
# 1. åˆ›å»ºä¸“ç”¨çš„truststore
keytool -import -alias mysql-server -file mysql-server.crt -keystore mysql-truststore.jks

# 2. è®¾ç½®åˆé€‚çš„æƒé™
chmod 600 mysql-truststore.jks
chown app:app mysql-truststore.jks

# 3. å®šæœŸæ›´æ–°è¯ä¹¦
# åœ¨è¯ä¹¦è¿‡æœŸå‰30å¤©æ›´æ–°
```

**é…ç½®æ–‡ä»¶å®‰å…¨**ï¼š
```yaml
spring:
  datasource:
    hikari:
      dataSourceProperties:
        # ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
        trustCertificateKeyStorePassword: ${TRUSTSTORE_PASSWORD}
        clientCertificateKeyStorePassword: ${CLIENT_KEYSTORE_PASSWORD}
```

### 7.3 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®


**ğŸ”¸ éƒ¨ç½²æ£€æŸ¥æ¸…å•**ï¼š

- [ ] **SSLç‰ˆæœ¬æ£€æŸ¥**ï¼šç¡®ä¿ä½¿ç”¨TLS 1.2æˆ–æ›´é«˜ç‰ˆæœ¬
- [ ] **è¯ä¹¦æœ‰æ•ˆæœŸ**ï¼šè®¾ç½®è¯ä¹¦è¿‡æœŸç›‘æ§å‘Šè­¦  
- [ ] **åŠ å¯†å¼ºåº¦**ï¼šä½¿ç”¨256ä½AESåŠ å¯†
- [ ] **è¿æ¥é™åˆ¶**ï¼šè®¾ç½®åˆç†çš„è¿æ¥æ± å¤§å°ä¸Šé™
- [ ] **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®SSLè¿æ¥å¼‚å¸¸å‘Šè­¦
- [ ] **æ—¥å¿—å®¡è®¡**ï¼šè®°å½•SSLè¿æ¥å»ºç«‹å’Œå¤±è´¥æ—¥å¿—
- [ ] **å®šæœŸæµ‹è¯•**ï¼šæ¨¡æ‹ŸSSLè¿æ¥æ•…éšœåœºæ™¯

**ç¯å¢ƒé…ç½®ç¤ºä¾‹**ï¼š
```yaml
# ç”Ÿäº§ç¯å¢ƒé…ç½®
spring:
  profiles:
    active: production
  datasource:
    hikari:
      maximum-pool-size: 50      # æ ¹æ®å¹¶å‘é‡è°ƒæ•´
      minimum-idle: 10           # ä¿æŒæœ€å°‘SSLè¿æ¥
      max-lifetime: 900000       # 15åˆ†é’Ÿè¿æ¥ç”Ÿå‘½å‘¨æœŸ
      connection-timeout: 20000   # 20ç§’è¿æ¥è¶…æ—¶
      validation-timeout: 5000    # 5ç§’éªŒè¯è¶…æ—¶
      leak-detection-threshold: 60000  # 1åˆ†é’Ÿæ³„éœ²æ£€æµ‹
      
      dataSourceProperties:
        useSSL: true
        requireSSL: true
        verifyServerCertificate: true
        sslMode: VERIFY_IDENTITY
        enabledSSLProtocols: TLSv1.3
        
logging:
  level:
    com.zaxxer.hikari: DEBUG      # è¿æ¥æ± è¯¦ç»†æ—¥å¿—
    org.springframework.jdbc: DEBUG  # JDBCæ“ä½œæ—¥å¿—
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SSLè¿æ¥æ± æœ¬è´¨ï¼šç®¡ç†åŠ å¯†æ•°æ®åº“è¿æ¥çš„å®¹å™¨ï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½
ğŸ”¸ è¿æ¥å¤ç”¨æœºåˆ¶ï¼šé€šè¿‡å¤ç”¨SSLè¿æ¥å‡å°‘æ¡æ‰‹å¼€é”€ï¼Œæå‡æ•´ä½“æ€§èƒ½  
ğŸ”¸ å®‰å…¨é…ç½®è¦ç‚¹ï¼šå¼ºåˆ¶SSLã€è¯ä¹¦éªŒè¯ã€ç®—æ³•é€‰æ‹©ã€ç‰ˆæœ¬æ§åˆ¶
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼šä¼šè¯å¤ç”¨ã€è¿æ¥é¢„çƒ­ã€å‚æ•°è°ƒä¼˜ã€ç›‘æ§å‘Šè­¦
ğŸ”¸ ç›‘æ§æŒ‡æ ‡ä½“ç³»ï¼šè¿æ¥æ•°ã€å»¶è¿Ÿã€å®‰å…¨æ€§ã€ç¨³å®šæ€§å››ä¸ªç»´åº¦
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦SSLè¿æ¥æ± **ï¼š
```
å®‰å…¨éœ€æ±‚ï¼š
- æ•°æ®ä¼ è¾“åŠ å¯†ä¿æŠ¤
- é˜²æ­¢ç½‘ç»œçªƒå¬å’Œç¯¡æ”¹
- æ»¡è¶³åˆè§„å’Œå®‰å…¨æ ‡å‡†

æ€§èƒ½è€ƒè™‘ï¼š
- SSLæ¡æ‰‹è€—æ—¶è¾ƒé•¿(100-300ms)
- è¿æ¥å¤ç”¨å‡å°‘æ¡æ‰‹æ¬¡æ•°
- æå‡åº”ç”¨å“åº”é€Ÿåº¦
```

**ğŸ”¹ é…ç½®å¤æ‚æ€§çš„å¹³è¡¡**ï¼š
```
å®‰å…¨æ€§ vs æ€§èƒ½ï¼š
- æ›´å¼ºçš„åŠ å¯† = æ›´é«˜çš„CPUå¼€é”€
- æ›´ä¸¥æ ¼çš„éªŒè¯ = æ›´é•¿çš„è¿æ¥æ—¶é—´
- éœ€è¦æ‰¾åˆ°é€‚åˆä¸šåŠ¡çš„å¹³è¡¡ç‚¹

å¤æ‚æ€§ vs æ”¶ç›Šï¼š
- åŸºç¡€SSLé…ç½®ï¼šå®‰å…¨ä½†ç®€å•
- é«˜çº§ä¼˜åŒ–é…ç½®ï¼šæ€§èƒ½å¥½ä½†å¤æ‚
- æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©é…ç½®æ·±åº¦
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- **é‡‘èç³»ç»Ÿ**ï¼šå¼ºåˆ¶SSLè¿æ¥ï¼Œä¸¥æ ¼è¯ä¹¦éªŒè¯
- **ç”µå•†å¹³å°**ï¼šSSLè¿æ¥æ± ä¼˜åŒ–ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **ä¼ä¸šåº”ç”¨**ï¼šåŒå‘SSLè®¤è¯ï¼Œç¡®ä¿å†…ç½‘å®‰å…¨
- **äº‘æœåŠ¡**ï¼šSSLç›‘æ§å‘Šè­¦ï¼Œä¿éšœæœåŠ¡ç¨³å®šæ€§

**ğŸ”§ è¿ç»´å®è·µ**ï¼š
- **é…ç½®ç®¡ç†**ï¼šæ ‡å‡†åŒ–SSLè¿æ¥æ± é…ç½®æ¨¡æ¿
- **ç›‘æ§ä½“ç³»**ï¼šå»ºç«‹SSLè¿æ¥å¥åº·æ£€æŸ¥æœºåˆ¶  
- **æ•…éšœå¤„ç†**ï¼šSSLè¿æ¥å¼‚å¸¸çš„å¿«é€Ÿå®šä½å’Œæ¢å¤
- **å®‰å…¨åˆè§„**ï¼šæ»¡è¶³æ•°æ®ä¿æŠ¤æ³•è§„è¦æ±‚

### 8.4 å­¦ä¹ å»ºè®®


**ğŸ”¹ å­¦ä¹ è·¯å¾„**ï¼š
1. **åŸºç¡€ç†è§£**ï¼šSSLåè®®åŸç†å’Œè¿æ¥æ± æ¦‚å¿µ
2. **é…ç½®å®è·µ**ï¼šä¸åŒè¿æ¥æ± çš„SSLé…ç½®æ–¹æ³•
3. **æ€§èƒ½è°ƒä¼˜**ï¼šSSLæ¡æ‰‹ä¼˜åŒ–å’Œè¿æ¥å¤ç”¨
4. **ç›‘æ§è¿ç»´**ï¼šæŒ‡æ ‡æ”¶é›†å’Œå¥åº·æ£€æŸ¥
5. **å®‰å…¨ç­–ç•¥**ï¼šè¯ä¹¦ç®¡ç†å’Œæœ€ä½³å®è·µ

**ğŸ”¹ é¿å…å¸¸è§é”™è¯¯**ï¼š
- âŒ ç¦ç”¨SSLè¯ä¹¦éªŒè¯ï¼ˆå®‰å…¨é£é™©ï¼‰
- âŒ è¿æ¥æ± è¿‡å¤§ï¼ˆèµ„æºæµªè´¹ï¼‰
- âŒ å¿½ç•¥SSLæ¡æ‰‹ç›‘æ§ï¼ˆæ€§èƒ½é—®é¢˜ï¼‰
- âŒ è¯ä¹¦è¿‡æœŸæœªåŠæ—¶æ›´æ–°ï¼ˆæœåŠ¡ä¸­æ–­ï¼‰

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- SSLè¿æ¥æ± ï¼Œå®‰å…¨åˆé«˜æ•ˆ
- è¯ä¹¦éªŒè¯ï¼Œæ¡æ‰‹è¦ä¼˜åŒ–  
- å¤ç”¨è¿æ¥ï¼Œç›‘æ§ä¸èƒ½å°‘
- å®‰å…¨é…ç½®ï¼Œç”Ÿäº§è¦è§„èŒƒ