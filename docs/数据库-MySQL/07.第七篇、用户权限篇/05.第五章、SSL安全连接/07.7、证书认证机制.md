---
title: 7ã€è¯ä¹¦è®¤è¯æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [è¯ä¹¦è®¤è¯åŸºç¡€æ¦‚å¿µ](#1-è¯ä¹¦è®¤è¯åŸºç¡€æ¦‚å¿µ)
2. [è¯ä¹¦è®¤è¯æµç¨‹è¯¦è§£](#2-è¯ä¹¦è®¤è¯æµç¨‹è¯¦è§£)
3. [åŒå‘è®¤è¯é…ç½®å®æˆ˜](#3-åŒå‘è®¤è¯é…ç½®å®æˆ˜)
4. [è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†](#4-è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†)
5. [è¯ä¹¦å®‰å…¨éªŒè¯æœºåˆ¶](#5-è¯ä¹¦å®‰å…¨éªŒè¯æœºåˆ¶)
6. [è¯ä¹¦çŠ¶æ€æ£€æŸ¥ä¸ç›‘æ§](#6-è¯ä¹¦çŠ¶æ€æ£€æŸ¥ä¸ç›‘æ§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” è¯ä¹¦è®¤è¯åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SSLè¯ä¹¦è®¤è¯

**ç®€å•ç†è§£**ï¼šSSLè¯ä¹¦å°±åƒèº«ä»½è¯ï¼Œç”¨æ¥è¯æ˜"ä½ æ˜¯ä½ "ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
èº«ä»½è¯      â†’  SSLè¯ä¹¦
å…¬å®‰å±€ç­¾å‘  â†’  CAæœºæ„ç­¾å‘
èº«ä»½éªŒè¯    â†’  æœåŠ¡å™¨èº«ä»½éªŒè¯
é˜²ä¼ªç‰¹å¾    â†’  æ•°å­—ç­¾å
```

**ğŸ”¸ æ ¸å¿ƒä½œç”¨**ï¼š
- **èº«ä»½éªŒè¯**ï¼šç¡®è®¤æœåŠ¡å™¨èº«ä»½çš„çœŸå®æ€§
- **æ•°æ®åŠ å¯†**ï¼šä¿æŠ¤ä¼ è¾“æ•°æ®ä¸è¢«çªƒå–
- **å®Œæ•´æ€§æ ¡éªŒ**ï¼šç¡®ä¿æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹

### 1.2 MySQLä¸­çš„è¯ä¹¦ç±»å‹


**ğŸ“‹ ä¸‰ç§æ ¸å¿ƒè¯ä¹¦**ï¼š
```
CAè¯ä¹¦ (ca.pem)
â”œâ”€â”€ ä½œç”¨ï¼šè¯ä¹¦é¢å‘æœºæ„çš„æ ¹è¯ä¹¦
â”œâ”€â”€ åŠŸèƒ½ï¼šéªŒè¯å…¶ä»–è¯ä¹¦çš„åˆæ³•æ€§
â””â”€â”€ ç±»æ¯”ï¼šå…¬å®‰å±€çš„å®˜æ–¹å°ç« 

æœåŠ¡å™¨è¯ä¹¦ (server-cert.pem)
â”œâ”€â”€ ä½œç”¨ï¼šMySQLæœåŠ¡å™¨çš„èº«ä»½è¯æ˜
â”œâ”€â”€ åŠŸèƒ½ï¼šå‘å®¢æˆ·ç«¯è¯æ˜æœåŠ¡å™¨èº«ä»½
â””â”€â”€ ç±»æ¯”ï¼šæœåŠ¡å™¨çš„èº«ä»½è¯

å®¢æˆ·ç«¯è¯ä¹¦ (client-cert.pem)
â”œâ”€â”€ ä½œç”¨ï¼šå®¢æˆ·ç«¯çš„èº«ä»½è¯æ˜
â”œâ”€â”€ åŠŸèƒ½ï¼šå‘æœåŠ¡å™¨è¯æ˜å®¢æˆ·ç«¯èº«ä»½
â””â”€â”€ ç±»æ¯”ï¼šç”¨æˆ·çš„èº«ä»½è¯
```

### 1.3 è¯ä¹¦æ–‡ä»¶ç»„æˆ

```
è¯ä¹¦æ–‡ä»¶ç»“æ„ï¼š
ğŸ“ SSLè¯ä¹¦ç›®å½•
â”œâ”€â”€ ğŸ“„ ca.pem          # CAæ ¹è¯ä¹¦ï¼ˆå…¬é’¥ï¼‰
â”œâ”€â”€ ğŸ”‘ ca-key.pem      # CAç§é’¥
â”œâ”€â”€ ğŸ“„ server-cert.pem # æœåŠ¡å™¨è¯ä¹¦
â”œâ”€â”€ ğŸ”‘ server-key.pem  # æœåŠ¡å™¨ç§é’¥
â”œâ”€â”€ ğŸ“„ client-cert.pem # å®¢æˆ·ç«¯è¯ä¹¦
â””â”€â”€ ğŸ”‘ client-key.pem  # å®¢æˆ·ç«¯ç§é’¥
```

---

## 2. ğŸ”„ è¯ä¹¦è®¤è¯æµç¨‹è¯¦è§£


### 2.1 å•å‘è®¤è¯æµç¨‹

**åŸºæœ¬æ¦‚å¿µ**ï¼šåªéªŒè¯æœåŠ¡å™¨èº«ä»½ï¼Œå®¢æˆ·ç«¯ä¿¡ä»»æœåŠ¡å™¨å³å¯ã€‚

```
å•å‘è®¤è¯æµç¨‹å›¾ï¼š
å®¢æˆ·ç«¯                    MySQLæœåŠ¡å™¨
  |                          |
  |--[1]è¿æ¥è¯·æ±‚------------>|
  |                          |
  |<--[2]å‘é€æœåŠ¡å™¨è¯ä¹¦-------|
  |                          |
  |--[3]éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§--------|
  |    (æ£€æŸ¥CAç­¾å)          |
  |                          |
  |--[4]å»ºç«‹åŠ å¯†è¿æ¥-------->|
  |                          |
  |<====å®‰å…¨é€šä¿¡é€šé“======>|
```

**ğŸ”¸ éªŒè¯æ­¥éª¤è¯¦è§£**ï¼š
1. **è¯ä¹¦æ¥æ”¶**ï¼šå®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡å™¨è¯ä¹¦
2. **CAéªŒè¯**ï¼šæ£€æŸ¥è¯ä¹¦æ˜¯å¦ç”±å—ä¿¡ä»»çš„CAç­¾å‘
3. **æœ‰æ•ˆæœŸæ£€æŸ¥**ï¼šç¡®è®¤è¯ä¹¦æœªè¿‡æœŸ
4. **åŸŸååŒ¹é…**ï¼šéªŒè¯è¯ä¹¦åŸŸåä¸æœåŠ¡å™¨åœ°å€åŒ¹é…

### 2.2 åŒå‘è®¤è¯æµç¨‹

**è¿›é˜¶æ¦‚å¿µ**ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº’ç›¸éªŒè¯èº«ä»½ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚

```
åŒå‘è®¤è¯æµç¨‹å›¾ï¼š
å®¢æˆ·ç«¯                    MySQLæœåŠ¡å™¨
  |                          |
  |--[1]è¿æ¥è¯·æ±‚------------>|
  |                          |
  |<--[2]å‘é€æœåŠ¡å™¨è¯ä¹¦-------|
  |                          |
  |--[3]éªŒè¯æœåŠ¡å™¨è¯ä¹¦--------|
  |                          |
  |--[4]å‘é€å®¢æˆ·ç«¯è¯ä¹¦------->|
  |                          |
  |<--[5]éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦-------|
  |                          |
  |--[6]åŒå‘è®¤è¯æˆåŠŸ-------->|
  |                          |
  |<====å®‰å…¨é€šä¿¡é€šé“======>|
```

### 2.3 è®¤è¯è¿‡ç¨‹çš„å…³é”®æ£€æŸ¥ç‚¹


**ğŸ›¡ï¸ æœåŠ¡å™¨ç«¯æ£€æŸ¥**ï¼š
```sql
-- æŸ¥çœ‹SSLè®¤è¯çŠ¶æ€
SHOW STATUS LIKE 'Ssl%';

-- æ£€æŸ¥å½“å‰è¿æ¥çš„è¯ä¹¦ä¿¡æ¯
SELECT 
    CONNECTION_ID(),
    SSL_CIPHER,
    SSL_VERSION
FROM performance_schema.session_status 
WHERE VARIABLE_NAME = 'Ssl_cipher';
```

**ğŸ” å®¢æˆ·ç«¯æ£€æŸ¥**ï¼š
```bash
# éªŒè¯æœåŠ¡å™¨è¯ä¹¦
openssl verify -CAfile ca.pem server-cert.pem

# æ£€æŸ¥è¯ä¹¦è¯¦ç»†ä¿¡æ¯
openssl x509 -in server-cert.pem -text -noout
```

---

## 3. âš™ï¸ åŒå‘è®¤è¯é…ç½®å®æˆ˜


### 3.1 MySQLæœåŠ¡å™¨é…ç½®

**é…ç½®æ–‡ä»¶è®¾ç½®**ï¼šåŒå‘è®¤è¯éœ€è¦åœ¨my.cnfä¸­å¯ç”¨å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯ã€‚

```ini
[mysqld]
# å¯ç”¨SSL
ssl-ca=/path/to/ca.pem
ssl-cert=/path/to/server-cert.pem
ssl-key=/path/to/server-key.pem

# å¼ºåˆ¶åŒå‘è®¤è¯
require_secure_transport=ON
ssl-cipher=ECDHE-RSA-AES128-GCM-SHA256

# å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯
ssl-crl=/path/to/crl.pem          # è¯ä¹¦åŠé”€åˆ—è¡¨
ssl-crlpath=/path/to/crl/         # CRLç›®å½•
```

### 3.2 ç”¨æˆ·çº§åˆ«è®¤è¯é…ç½®

**åˆ›å»ºéœ€è¦è¯ä¹¦è®¤è¯çš„ç”¨æˆ·**ï¼š

```sql
-- åˆ›å»ºè¦æ±‚SSLè¿æ¥çš„ç”¨æˆ·
CREATE USER 'secure_user'@'%' 
IDENTIFIED BY 'password' 
REQUIRE SSL;

-- åˆ›å»ºè¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦çš„ç”¨æˆ·
CREATE USER 'cert_user'@'%' 
IDENTIFIED BY 'password' 
REQUIRE X509;

-- åˆ›å»ºè¦æ±‚ç‰¹å®šè¯ä¹¦ä¸»ä½“çš„ç”¨æˆ·
CREATE USER 'specific_user'@'%' 
IDENTIFIED BY 'password' 
REQUIRE SUBJECT '/CN=client/O=MyOrg/C=US';
```

### 3.3 å®¢æˆ·ç«¯è¿æ¥é…ç½®

**å‘½ä»¤è¡Œè¿æ¥ç¤ºä¾‹**ï¼š

```bash
# åŸºæœ¬SSLè¿æ¥
mysql -h localhost -u secure_user -p \
  --ssl-ca=ca.pem \
  --ssl-cert=client-cert.pem \
  --ssl-key=client-key.pem

# å¼ºåˆ¶SSLæ¨¡å¼
mysql -h localhost -u cert_user -p \
  --ssl-mode=REQUIRED \
  --ssl-ca=ca.pem \
  --ssl-cert=client-cert.pem \
  --ssl-key=client-key.pem
```

**åº”ç”¨ç¨‹åºé…ç½®ç¤ºä¾‹**ï¼š
```python
import mysql.connector

# Pythonå®¢æˆ·ç«¯åŒå‘è®¤è¯
config = {
    'host': 'localhost',
    'user': 'cert_user',
    'password': 'password',
    'ssl_ca': '/path/to/ca.pem',
    'ssl_cert': '/path/to/client-cert.pem',
    'ssl_key': '/path/to/client-key.pem',
    'ssl_verify_cert': True
}

conn = mysql.connector.connect(**config)
```

---

## 4. â° è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†


### 4.1 è¯ä¹¦æœ‰æ•ˆæœŸç®¡ç†

**åŸºæœ¬æ¦‚å¿µ**ï¼šè¯ä¹¦éƒ½æœ‰æœ‰æ•ˆæœŸï¼Œè¿‡æœŸåä¼šå¯¼è‡´è¿æ¥å¤±è´¥ï¼Œéœ€è¦æå‰æ›´æ–°ã€‚

**ğŸ”¸ æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ**ï¼š
```bash
# æŸ¥çœ‹è¯ä¹¦åˆ°æœŸæ—¶é—´
openssl x509 -in server-cert.pem -noout -dates

# æ£€æŸ¥è¯ä¹¦æ˜¯å¦å³å°†è¿‡æœŸï¼ˆ30å¤©å†…ï¼‰
openssl x509 -in server-cert.pem -checkend 2592000
echo $?  # 0=æœªè¿‡æœŸ, 1=å³å°†è¿‡æœŸ
```

**ğŸ“… æœ‰æ•ˆæœŸç›‘æ§è„šæœ¬**ï¼š
```bash
#!/bin/bash
# è¯ä¹¦åˆ°æœŸç›‘æ§è„šæœ¬

CERT_FILE="/path/to/server-cert.pem"
DAYS_WARNING=30

# è·å–è¯ä¹¦åˆ°æœŸæ—¥æœŸ
EXPIRE_DATE=$(openssl x509 -in $CERT_FILE -noout -enddate | cut -d= -f2)
EXPIRE_TIMESTAMP=$(date -d "$EXPIRE_DATE" +%s)
CURRENT_TIMESTAMP=$(date +%s)

# è®¡ç®—å‰©ä½™å¤©æ•°
DAYS_LEFT=$(( ($EXPIRE_TIMESTAMP - $CURRENT_TIMESTAMP) / 86400 ))

if [ $DAYS_LEFT -lt $DAYS_WARNING ]; then
    echo "è­¦å‘Šï¼šè¯ä¹¦å°†åœ¨ $DAYS_LEFT å¤©åè¿‡æœŸï¼"
    # å‘é€å‘Šè­¦é‚®ä»¶æˆ–é€šçŸ¥
fi
```

### 4.2 è¯ä¹¦è‡ªåŠ¨æ›´æ–°æœºåˆ¶

**å®ç°æ€è·¯**ï¼šé€šè¿‡è„šæœ¬è‡ªåŠ¨æ£€æŸ¥å’Œæ›´æ–°å³å°†è¿‡æœŸçš„è¯ä¹¦ã€‚

**ğŸ”„ è‡ªåŠ¨æ›´æ–°æµç¨‹**ï¼š
```
è¯ä¹¦æ›´æ–°æµç¨‹ï¼š
ç›‘æ§è„šæœ¬æ£€æŸ¥åˆ°æœŸæ—¶é—´
        â†“
è§¦å‘è¯ä¹¦ç»­æœŸè¯·æ±‚
        â†“
ç”Ÿæˆæ–°çš„è¯ä¹¦æ–‡ä»¶
        â†“
éªŒè¯æ–°è¯ä¹¦æœ‰æ•ˆæ€§
        â†“
çƒ­æ›´æ–°MySQLé…ç½®
        â†“
éªŒè¯SSLè¿æ¥æ­£å¸¸
```

**è‡ªåŠ¨æ›´æ–°è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# MySQLè¯ä¹¦è‡ªåŠ¨æ›´æ–°è„šæœ¬

OLD_CERT="/etc/mysql/ssl/server-cert.pem"
NEW_CERT="/tmp/new-server-cert.pem"

# 1. ç”Ÿæˆæ–°è¯ä¹¦ï¼ˆç¤ºä¾‹ï¼Œå®é™…éœ€è¦è¿æ¥CAï¼‰
generate_new_certificate() {
    # è¿™é‡Œè°ƒç”¨CA APIæˆ–è¯ä¹¦ç®¡ç†å·¥å…·
    echo "ç”Ÿæˆæ–°è¯ä¹¦..."
}

# 2. éªŒè¯æ–°è¯ä¹¦
validate_certificate() {
    openssl verify -CAfile ca.pem $NEW_CERT
    return $?
}

# 3. çƒ­æ›´æ–°MySQL
update_mysql_ssl() {
    # å¤‡ä»½æ—§è¯ä¹¦
    cp $OLD_CERT "${OLD_CERT}.backup.$(date +%Y%m%d)"
    
    # æ›¿æ¢è¯ä¹¦æ–‡ä»¶
    cp $NEW_CERT $OLD_CERT
    
    # é‡æ–°åŠ è½½SSLé…ç½®
    mysql -e "ALTER INSTANCE RELOAD TLS;"
}
```

### 4.3 è¯ä¹¦è½®æ¢ç­–ç•¥

**æœ€ä½³å®è·µ**ï¼šå»ºç«‹è¯ä¹¦è½®æ¢è®¡åˆ’ï¼Œé¿å…æœåŠ¡ä¸­æ–­ã€‚

| **è½®æ¢å‘¨æœŸ** | **è¯ä¹¦ç±»å‹** | **å»ºè®®ç­–ç•¥** |
|-------------|-------------|-------------|
| **1å¹´** | ç”Ÿäº§ç¯å¢ƒè¯ä¹¦ | æå‰90å¤©å¼€å§‹å‡†å¤‡ |
| **6ä¸ªæœˆ** | å¼€å‘æµ‹è¯•è¯ä¹¦ | æå‰30å¤©æ›´æ–° |
| **3ä¸ªæœˆ** | ä¸´æ—¶è¯ä¹¦ | æå‰15å¤©æ›´æ–° |

---

## 5. ğŸ›¡ï¸ è¯ä¹¦å®‰å…¨éªŒè¯æœºåˆ¶


### 5.1 è¯ä¹¦åŠé”€åˆ—è¡¨(CRL)

**åŸºæœ¬æ¦‚å¿µ**ï¼šCRLæ˜¯å·²è¢«åŠé”€è¯ä¹¦çš„é»‘åå•ï¼Œç”¨äºæ£€æŸ¥è¯ä¹¦æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚

**ğŸ”¸ CRLå·¥ä½œåŸç†**ï¼š
```
CRLéªŒè¯æµç¨‹ï¼š
å®¢æˆ·ç«¯è·å–è¯ä¹¦
        â†“
æŸ¥è¯¢CRLåˆ—è¡¨
        â†“
æ£€æŸ¥è¯ä¹¦åºåˆ—å·æ˜¯å¦åœ¨CRLä¸­
        â†“
æ‹’ç»å·²åŠé”€è¯ä¹¦    æ¥å—æœ‰æ•ˆè¯ä¹¦
```

**é…ç½®CRLæ£€æŸ¥**ï¼š
```ini
[mysqld]
# å¯ç”¨CRLæ£€æŸ¥
ssl-crl=/path/to/mysql-crl.pem
ssl-crlpath=/path/to/crl/

# CRLä¸‹è½½æ›´æ–°è„šæœ¬
*/6 * * * * /scripts/update-crl.sh
```

**CRLæ›´æ–°è„šæœ¬**ï¼š
```bash
#!/bin/bash
# CRLè‡ªåŠ¨æ›´æ–°è„šæœ¬

CRL_URL="https://ca.example.com/crl.pem"
CRL_FILE="/etc/mysql/ssl/crl.pem"

# ä¸‹è½½æœ€æ–°CRL
curl -s $CRL_URL -o ${CRL_FILE}.new

# éªŒè¯CRLæ ¼å¼
if openssl crl -in ${CRL_FILE}.new -noout 2>/dev/null; then
    mv ${CRL_FILE}.new $CRL_FILE
    echo "CRLæ›´æ–°æˆåŠŸ"
else
    echo "CRLæ ¼å¼é”™è¯¯ï¼Œä¿æŒåŸæœ‰æ–‡ä»¶"
    rm ${CRL_FILE}.new
fi
```

### 5.2 è¯ä¹¦ä¿¡ä»»é“¾éªŒè¯

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šéªŒè¯è¯ä¹¦æ˜¯å¦ç”±å¯ä¿¡çš„è¯ä¹¦é“¾ç­¾å‘ï¼Œç¡®ä¿è¯ä¹¦æ¥æºå¯é ã€‚

**ğŸ”— ä¿¡ä»»é“¾ç»“æ„**ï¼š
```
è¯ä¹¦ä¿¡ä»»é“¾ï¼š
æ ¹CAè¯ä¹¦ (Root CA)
    â†“ ç­¾å‘
ä¸­é—´CAè¯ä¹¦ (Intermediate CA)
    â†“ ç­¾å‘
æœåŠ¡å™¨è¯ä¹¦ (Server Certificate)
```

**ä¿¡ä»»é“¾éªŒè¯ä»£ç **ï¼š
```bash
# éªŒè¯å®Œæ•´è¯ä¹¦é“¾
openssl verify -CAfile ca-bundle.pem \
  -untrusted intermediate-ca.pem \
  server-cert.pem

# æ˜¾ç¤ºè¯ä¹¦é“¾ä¿¡æ¯
openssl s_client -connect mysql.example.com:3306 \
  -showcerts -verify 5
```

### 5.3 è¯ä¹¦è®¤è¯å®‰å…¨ç­–ç•¥

**å®‰å…¨é…ç½®å»ºè®®**ï¼š

```sql
-- æŸ¥çœ‹å½“å‰SSLç­–ç•¥
SHOW VARIABLES LIKE '%ssl%';

-- å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šSSLç‰ˆæœ¬
SET GLOBAL tls_version = 'TLSv1.2,TLSv1.3';

-- è®¾ç½®å…è®¸çš„åŠ å¯†å¥—ä»¶
SET GLOBAL ssl_cipher = 'ECDHE-RSA-AES256-GCM-SHA384';
```

**ğŸ” å®‰å…¨ç­–ç•¥ç­‰çº§**ï¼š

| **å®‰å…¨çº§åˆ«** | **é…ç½®è¦æ±‚** | **é€‚ç”¨åœºæ™¯** |
|-------------|-------------|-------------|
| **åŸºç¡€** | ä»…è¦æ±‚SSLè¿æ¥ | å¼€å‘ç¯å¢ƒ |
| **æ ‡å‡†** | è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ | ç”Ÿäº§ç¯å¢ƒ |
| **ä¸¥æ ¼** | æŒ‡å®šè¯ä¹¦ä¸»ä½“ | é‡‘èçº§å®‰å…¨ |

---

## 6. ğŸ“Š è¯ä¹¦çŠ¶æ€æ£€æŸ¥ä¸ç›‘æ§


### 6.1 åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®(OCSP)

**åŸºæœ¬æ¦‚å¿µ**ï¼šOCSPæ˜¯å®æ—¶æ£€æŸ¥è¯ä¹¦çŠ¶æ€çš„åè®®ï¼Œæ¯”CRLæ›´åŠæ—¶å‡†ç¡®ã€‚

**ğŸ”¸ OCSP vs CRLå¯¹æ¯”**ï¼š

| **ç‰¹æ€§** | **OCSP** | **CRL** |
|---------|----------|---------|
| **å®æ—¶æ€§** | å®æ—¶æŸ¥è¯¢ | å®šæœŸæ›´æ–° |
| **ç½‘ç»œå¼€é”€** | å•è¯ä¹¦æŸ¥è¯¢ | ä¸‹è½½å®Œæ•´åˆ—è¡¨ |
| **å“åº”é€Ÿåº¦** | å¿«é€Ÿå“åº” | æœ¬åœ°æŸ¥è¯¢å¿« |
| **å¯é æ€§** | ä¾èµ–OCSPæœåŠ¡ | ç¦»çº¿å¯ç”¨ |

**OCSPé…ç½®ç¤ºä¾‹**ï¼š
```bash
# æ£€æŸ¥è¯ä¹¦OCSPçŠ¶æ€
openssl ocsp -issuer ca.pem \
  -cert server-cert.pem \
  -url http://ocsp.example.com \
  -resp_text

# MySQLå®¢æˆ·ç«¯OCSPéªŒè¯
mysql --ssl-mode=VERIFY_CA \
  --ssl-ca=ca.pem \
  --ssl-cert=client-cert.pem \
  --ssl-key=client-key.pem \
  --ssl-verify-server-cert
```

### 6.2 è¯ä¹¦é€æ˜åº¦æ—¥å¿—(CT)

**å®‰å…¨æœºåˆ¶**ï¼šCTè®°å½•æ‰€æœ‰å…¬å¼€ç­¾å‘çš„è¯ä¹¦ï¼Œç”¨äºæ£€æµ‹æ¶æ„æˆ–é”™è¯¯ç­¾å‘çš„è¯ä¹¦ã€‚

**ğŸ” CTæ—¥å¿—æ£€æŸ¥**ï¼š
```bash
# æŸ¥è¯¢è¯ä¹¦æ˜¯å¦åœ¨CTæ—¥å¿—ä¸­
curl -s "https://crt.sh/?q=mysql.example.com&output=json" | \
  jq '.[] | {id, name_value, not_before, not_after}'

# éªŒè¯è¯ä¹¦CTæ‰©å±•
openssl x509 -in server-cert.pem -text | \
  grep -A 5 "CT Precertificate SCTs"
```

### 6.3 è¯ä¹¦ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

**ç›‘æ§è„šæœ¬å®ç°**ï¼š

```python
#!/usr/bin/env python3
# MySQL SSLè¯ä¹¦ç›‘æ§è„šæœ¬

import ssl
import socket
import datetime
import smtplib
from email.mime.text import MIMEText

class SSLMonitor:
    def __init__(self, host, port=3306):
        self.host = host
        self.port = port
    
    def check_certificate(self):
        """æ£€æŸ¥è¯ä¹¦çŠ¶æ€"""
        try:
            # è·å–è¯ä¹¦ä¿¡æ¯
            context = ssl.create_default_context()
            with socket.create_connection((self.host, self.port), timeout=10) as sock:
                with context.wrap_socket(sock, server_hostname=self.host) as ssock:
                    cert = ssock.getpeercert()
            
            # è§£æåˆ°æœŸæ—¶é—´
            expire_date = datetime.datetime.strptime(
                cert['notAfter'], '%b %d %H:%M:%S %Y %Z'
            )
            
            # è®¡ç®—å‰©ä½™å¤©æ•°
            days_left = (expire_date - datetime.datetime.now()).days
            
            return {
                'status': 'valid',
                'expire_date': expire_date,
                'days_left': days_left,
                'subject': cert.get('subject', []),
                'issuer': cert.get('issuer', [])
            }
            
        except Exception as e:
            return {'status': 'error', 'error': str(e)}
    
    def send_alert(self, message):
        """å‘é€å‘Šè­¦é‚®ä»¶"""
        # é‚®ä»¶é…ç½®
        smtp_server = 'smtp.example.com'
        sender = 'monitor@example.com'
        receivers = ['admin@example.com']
        
        msg = MIMEText(message)
        msg['Subject'] = f'MySQL SSLè¯ä¹¦å‘Šè­¦ - {self.host}'
        msg['From'] = sender
        msg['To'] = ', '.join(receivers)
        
        try:
            server = smtplib.SMTP(smtp_server)
            server.sendmail(sender, receivers, msg.as_string())
            server.quit()
        except Exception as e:
            print(f"é‚®ä»¶å‘é€å¤±è´¥: {e}")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    monitor = SSLMonitor('mysql.example.com')
    result = monitor.check_certificate()
    
    if result['status'] == 'valid':
        if result['days_left'] < 30:
            alert_msg = f"""
            è¯ä¹¦å³å°†è¿‡æœŸè­¦å‘Šï¼š
            ä¸»æœº: {monitor.host}
            åˆ°æœŸæ—¶é—´: {result['expire_date']}
            å‰©ä½™å¤©æ•°: {result['days_left']}
            """
            monitor.send_alert(alert_msg)
    else:
        error_msg = f"è¯ä¹¦æ£€æŸ¥å¤±è´¥: {result['error']}"
        monitor.send_alert(error_msg)
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¯ä¹¦è®¤è¯æœ¬è´¨ï¼šé€šè¿‡æ•°å­—è¯ä¹¦éªŒè¯é€šä¿¡åŒæ–¹èº«ä»½
ğŸ”¸ åŒå‘è®¤è¯æœºåˆ¶ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº’ç›¸éªŒè¯ï¼Œå®‰å…¨æ€§æ›´é«˜
ğŸ”¸ è¯ä¹¦ç”Ÿå‘½å‘¨æœŸï¼šåŒ…æ‹¬ç­¾å‘ã€ä½¿ç”¨ã€æ›´æ–°ã€åŠé”€çš„å®Œæ•´æµç¨‹
ğŸ”¸ ä¿¡ä»»é“¾éªŒè¯ï¼šç¡®ä¿è¯ä¹¦ç”±å¯ä¿¡CAç­¾å‘
ğŸ”¸ çŠ¶æ€æ£€æŸ¥æœºåˆ¶ï¼šé€šè¿‡CRLã€OCSPç­‰æ–¹å¼éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§
```

### 7.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ æœåŠ¡å™¨ç«¯é…ç½®**ï¼š
```ini
# åŸºç¡€SSLé…ç½®
ssl-ca=ca.pem
ssl-cert=server-cert.pem  
ssl-key=server-key.pem

# å®‰å…¨å¢å¼ºé…ç½®
require_secure_transport=ON
ssl-crl=crl.pem
tls_version=TLSv1.2,TLSv1.3
```

**ğŸ”¹ å®¢æˆ·ç«¯è¿æ¥**ï¼š
```bash
mysql --ssl-mode=VERIFY_CA \
  --ssl-ca=ca.pem \
  --ssl-cert=client-cert.pem \
  --ssl-key=client-key.pem
```

### 7.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ“‹ è¯ä¹¦ç®¡ç†ç­–ç•¥**ï¼š
- **æå‰æ›´æ–°**ï¼šè¯ä¹¦åˆ°æœŸå‰30-90å¤©å¼€å§‹å‡†å¤‡æ›´æ–°
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹è‡ªåŠ¨åŒ–ç›‘æ§ç³»ç»Ÿï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- **å®šæœŸæ£€æŸ¥**ï¼šæ¯æœˆæ£€æŸ¥è¯ä¹¦çŠ¶æ€å’Œå®‰å…¨é…ç½®
- **å¤‡ä»½æ¢å¤**ï¼šä¿ç•™è¯ä¹¦å¤‡ä»½ï¼Œåˆ¶å®šåº”æ€¥é¢„æ¡ˆ

**ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤æªæ–½**ï¼š
- **æœ€å°æƒé™**ï¼šåªç»™å¿…è¦çš„ç”¨æˆ·åˆ†é…è¯ä¹¦æƒé™
- **å®šæœŸè½®æ¢**ï¼šå»ºç«‹è¯ä¹¦å®šæœŸæ›´æ¢æœºåˆ¶
- **æ—¥å¿—å®¡è®¡**ï¼šè®°å½•æ‰€æœ‰è¯ä¹¦ç›¸å…³æ“ä½œ
- **åŠ å¯†å­˜å‚¨**ï¼šä¿æŠ¤ç§é’¥æ–‡ä»¶çš„å®‰å…¨æ€§

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è¯ä¹¦å¦‚èº«ä»½è¯ï¼ŒéªŒè¯ä½ æ˜¯ä½ 
- åŒå‘è®¤è¯æ›´å®‰å…¨ï¼Œäº’ç›¸éªŒè¯æ‰æ”¾å¿ƒ  
- ç”Ÿå‘½å‘¨æœŸè¦ç®¡ç†ï¼Œåˆ°æœŸæ›´æ–°ä¸èƒ½å¿˜
- åŠé”€æ£€æŸ¥å¾ˆé‡è¦ï¼ŒOCSPå®æ—¶æ›´å¯é 