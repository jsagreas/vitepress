---
title: 3ã€å­—æ®µçº§åŠ å¯†ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [å­—æ®µçº§åŠ å¯†åŸºç¡€æ¦‚å¿µ](#1-å­—æ®µçº§åŠ å¯†åŸºç¡€æ¦‚å¿µ)
2. [æ•æ„Ÿå­—æ®µè¯†åˆ«ä¸åˆ†ç±»](#2-æ•æ„Ÿå­—æ®µè¯†åˆ«ä¸åˆ†ç±»)
3. [MySQLå†…ç½®åŠ å¯†å‡½æ•°](#3-MySQLå†…ç½®åŠ å¯†å‡½æ•°)
4. [åº”ç”¨å±‚åŠ å¯†å®ç°](#4-åº”ç”¨å±‚åŠ å¯†å®ç°)
5. [åŠ å¯†å­—æ®µç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–](#5-åŠ å¯†å­—æ®µç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–)
6. [é«˜çº§åŠ å¯†æŠ€æœ¯åº”ç”¨](#6-é«˜çº§åŠ å¯†æŠ€æœ¯åº”ç”¨)
7. [åŠ å¯†å®æ–½ç­–ç•¥ä¸æœ€ä½³å®è·µ](#7-åŠ å¯†å®æ–½ç­–ç•¥ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ å­—æ®µçº§åŠ å¯†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å­—æ®µçº§åŠ å¯†


**å­—æ®µçº§åŠ å¯†**æ˜¯æŒ‡å¯¹æ•°æ®åº“è¡¨ä¸­ç‰¹å®šå­—æ®µçš„æ•°æ®è¿›è¡ŒåŠ å¯†ä¿æŠ¤ï¼Œè€Œä¸æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“æˆ–è¡¨è¿›è¡ŒåŠ å¯†ã€‚

```
æ™®é€šå­˜å‚¨ vs å­—æ®µåŠ å¯†ï¼š

ç”¨æˆ·è¡¨ï¼ˆæœªåŠ å¯†ï¼‰ï¼š
| id | name    | phone       | email              |
|----|---------|-------------|--------------------|
| 1  | å¼ ä¸‰    | 13800138000 | zhangsan@email.com |

ç”¨æˆ·è¡¨ï¼ˆå­—æ®µåŠ å¯†ï¼‰ï¼š
| id | name    | phone_enc      | email_enc           |
|----|---------|----------------|---------------------|
| 1  | å¼ ä¸‰    | AES_ENCRYPT... | AES_ENCRYPT...      |
```

**ğŸ¯ æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- **é€‰æ‹©æ€§ä¿æŠ¤**ï¼šåªå¯¹æ•æ„Ÿå­—æ®µåŠ å¯†ï¼Œéæ•æ„Ÿæ•°æ®ä¿æŒæ˜æ–‡
- **ç»†ç²’åº¦æ§åˆ¶**ï¼šå¯ä»¥ä¸ºä¸åŒå­—æ®µè®¾ç½®ä¸åŒçš„åŠ å¯†ç­–ç•¥
- **æ€§èƒ½å¹³è¡¡**ï¼šåœ¨å®‰å…¨æ€§å’ŒæŸ¥è¯¢æ€§èƒ½ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å­—æ®µçº§åŠ å¯†


**ğŸ”¹ æ•°æ®æ³„éœ²é£é™©æ§åˆ¶**
```
é£é™©åœºæ™¯ï¼š
- æ•°æ®åº“å¤‡ä»½æ–‡ä»¶æ³„éœ²
- å†…éƒ¨äººå‘˜è¶Šæƒè®¿é—®
- ç³»ç»Ÿæ¼æ´å¯¼è‡´æ•°æ®æš´éœ²
- ç¬¬ä¸‰æ–¹æœåŠ¡å•†æ•°æ®æ»¥ç”¨

å­—æ®µåŠ å¯†é˜²æŠ¤æ•ˆæœï¼š
âœ… å³ä½¿æ•°æ®åº“è¢«å®Œå…¨è·å–ï¼Œæ•æ„Ÿä¿¡æ¯ä»ç„¶å—ä¿æŠ¤
âœ… é™ä½å†…éƒ¨äººå‘˜æ¥è§¦æ•æ„Ÿæ•°æ®çš„é£é™©
âœ… ç¬¦åˆæ•°æ®ä¿æŠ¤æ³•è§„è¦æ±‚ï¼ˆGDPRã€ä¸ªä¿æ³•ç­‰ï¼‰
```

**ğŸ”¹ åˆè§„æ€§è¦æ±‚**
- **ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•**ï¼šè¦æ±‚å¯¹ä¸ªäººæ•æ„Ÿä¿¡æ¯é‡‡å–æŠ€æœ¯ä¿æŠ¤æªæ–½
- **æ•°æ®å®‰å…¨æ³•**ï¼šé‡è¦æ•°æ®å’Œæ ¸å¿ƒæ•°æ®éœ€è¦åŠ å¯†ä¿æŠ¤
- **è¡Œä¸šæ ‡å‡†**ï¼šé‡‘èã€åŒ»ç–—ç­‰è¡Œä¸šçš„ç‰¹æ®Šåˆè§„è¦æ±‚

### 1.3 å­—æ®µåŠ å¯†çš„å®ç°å±‚çº§


```
æ•°æ®æµè½¬è¿‡ç¨‹ä¸­çš„åŠ å¯†ä½ç½®ï¼š

åº”ç”¨ç¨‹åº â†â†’ [åŠ å¯†å±‚] â†â†’ æ•°æ®åº“
    â†‘              â†‘
åº”ç”¨å±‚åŠ å¯†      æ•°æ®åº“å±‚åŠ å¯†

å®ç°æ–¹å¼å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åŠ å¯†ä½ç½®      â”‚   ä¼˜åŠ¿          â”‚   åŠ£åŠ¿          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨å±‚åŠ å¯†      â”‚ çµæ´»æ€§é«˜        â”‚ å¼€å‘å¤æ‚åº¦å¤§    â”‚
â”‚                 â”‚ å¯†é’¥ç®¡ç†å¯æ§    â”‚ å¤šåº”ç”¨ä¸€è‡´æ€§éš¾  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®åº“å±‚åŠ å¯†    â”‚ å®ç°ç®€å•        â”‚ å¯†é’¥ç®¡ç†å—é™    â”‚
â”‚                 â”‚ åº”ç”¨é€æ˜        â”‚ æ€§èƒ½å½±å“å¤§      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ¯ æ•æ„Ÿå­—æ®µè¯†åˆ«ä¸åˆ†ç±»


### 2.1 æ•æ„Ÿæ•°æ®è¯†åˆ«æ–¹æ³•


**æ•æ„Ÿå­—æ®µè¯†åˆ«**æ˜¯æŒ‡ç¡®å®šå“ªäº›æ•°æ®å­—æ®µåŒ…å«éœ€è¦ä¿æŠ¤çš„æ•æ„Ÿä¿¡æ¯ã€‚

**ğŸ”¹ æŒ‰æ•°æ®ç±»å‹åˆ†ç±»ï¼š**

```
ğŸ“± ä¸ªäººèº«ä»½ä¿¡æ¯ï¼ˆPIIï¼‰
â”œâ”€ èº«ä»½è¯å·ï¼šéœ€è¦å¼ºåŠ å¯†
â”œâ”€ æ‰‹æœºå·ç ï¼šéœ€è¦æ ¼å¼ä¿ç•™åŠ å¯†
â”œâ”€ é‚®ç®±åœ°å€ï¼šéœ€è¦éƒ¨åˆ†å¯æœç´¢åŠ å¯†
â””â”€ çœŸå®å§“åï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®š

ğŸ’³ è´¢åŠ¡æ•æ„Ÿä¿¡æ¯
â”œâ”€ é“¶è¡Œå¡å·ï¼šéœ€è¦æœ€é«˜çº§åˆ«åŠ å¯†
â”œâ”€ æ”¯ä»˜å¯†ç ï¼šå•å‘å“ˆå¸Œ+ç›å€¼
â”œâ”€ è´¦æˆ·ä½™é¢ï¼šéœ€è¦åŒæ€åŠ å¯†æ”¯æŒè®¡ç®—
â””â”€ äº¤æ˜“è®°å½•ï¼šéœ€è¦å®¡è®¡æ—¥å¿—åŠ å¯†

ğŸ¥ ç‰¹æ®Šæ•æ„Ÿä¿¡æ¯
â”œâ”€ åŒ»ç–—è®°å½•ï¼šéœ€è¦ç«¯åˆ°ç«¯åŠ å¯†
â”œâ”€ ç”Ÿç‰©ç‰¹å¾ï¼šéœ€è¦ä¸å¯é€†åŠ å¯†
â”œâ”€ ä½ç½®ä¿¡æ¯ï¼šéœ€è¦å·®åˆ†éšç§å¤„ç†
â””â”€ è¡Œä¸ºæ•°æ®ï¼šéœ€è¦åŒ¿ååŒ–å¤„ç†
```

### 2.2 æ•æ„Ÿçº§åˆ«åˆ’åˆ†


**ğŸ”¸ æ•æ„Ÿçº§åˆ«å®šä¹‰ï¼š**

| æ•æ„Ÿçº§åˆ« | æ•°æ®ç±»å‹ | åŠ å¯†è¦æ±‚ | ç¤ºä¾‹å­—æ®µ |
|---------|----------|----------|----------|
| **ğŸ”´ æé«˜** | æ³•å¾‹èº«ä»½ã€ç”Ÿç‰©ç‰¹å¾ | `AES-256` + å¯†é’¥è½®æ¢ | èº«ä»½è¯ã€æŒ‡çº¹ |
| **ğŸŸ¡ é«˜** | è´¢åŠ¡ã€è”ç³»æ–¹å¼ | `AES-128` + è®¿é—®æ§åˆ¶ | é“¶è¡Œå¡ã€æ‰‹æœºå· |
| **ğŸŸ¢ ä¸­** | ä¸ªäººåå¥½ã€è¡Œä¸º | `åŸºç¡€åŠ å¯†` + è„±æ• | åœ°å€ã€çˆ±å¥½ |
| **âšª ä½** | å…¬å¼€ä¿¡æ¯ | `å¯é€‰åŠ å¯†` | æ˜µç§°ã€å¤´åƒ |

### 2.3 å­—æ®µåŠ å¯†è®¾è®¡åŸåˆ™


**ğŸ¯ è®¾è®¡åŸåˆ™ï¼š**

```
1ï¸âƒ£ æœ€å°åŒ–åŸåˆ™
- åªåŠ å¯†çœŸæ­£éœ€è¦ä¿æŠ¤çš„å­—æ®µ
- é¿å…è¿‡åº¦åŠ å¯†å½±å“æ€§èƒ½

2ï¸âƒ£ åˆ†çº§ä¿æŠ¤åŸåˆ™  
- æ ¹æ®æ•æ„Ÿçº§åˆ«é€‰æ‹©åŠ å¯†å¼ºåº¦
- é«˜æ•æ„Ÿæ•°æ®ä½¿ç”¨æ›´å¼ºçš„åŠ å¯†ç®—æ³•

3ï¸âƒ£ å¯ç”¨æ€§å¹³è¡¡åŸåˆ™
- è€ƒè™‘åŠ å¯†å¯¹æŸ¥è¯¢å’Œç´¢å¼•çš„å½±å“
- é¢„ç•™å¿…è¦çš„æœç´¢å’Œç»Ÿè®¡åŠŸèƒ½

4ï¸âƒ£ å‰å‘å…¼å®¹åŸåˆ™
- è®¾è®¡æ—¶è€ƒè™‘æœªæ¥çš„è§£å¯†å’Œè¿ç§»éœ€æ±‚
- ä¿ç•™å¯†é’¥ç‰ˆæœ¬ä¿¡æ¯ç”¨äºç®—æ³•å‡çº§
```

---

## 3. ğŸ”§ MySQLå†…ç½®åŠ å¯†å‡½æ•°


### 3.1 AES_ENCRYPTå‡½æ•°è¯¦è§£


**AES_ENCRYPT**æ˜¯MySQLæä¾›çš„å¯¹ç§°åŠ å¯†å‡½æ•°ï¼ŒåŸºäºAESç®—æ³•ã€‚

**ğŸ”¹ åŸºæœ¬è¯­æ³•ï¼š**
```sql
AES_ENCRYPT(æ˜æ–‡æ•°æ®, å¯†é’¥)
AES_DECRYPT(å¯†æ–‡æ•°æ®, å¯†é’¥)
```

**ğŸ”¹ å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼š**
```sql
-- æ’å…¥åŠ å¯†æ•°æ®
INSERT INTO users (name, phone_encrypted, email_encrypted) 
VALUES (
    'å¼ ä¸‰',
    AES_ENCRYPT('13800138000', 'my_secret_key_2024'),
    AES_ENCRYPT('zhangsan@email.com', 'my_secret_key_2024')
);

-- æŸ¥è¯¢è§£å¯†æ•°æ®
SELECT 
    name,
    AES_DECRYPT(phone_encrypted, 'my_secret_key_2024') AS phone,
    AES_DECRYPT(email_encrypted, 'my_secret_key_2024') AS email
FROM users 
WHERE id = 1;
```

### 3.2 åŠ å¯†æ¨¡å¼é€‰æ‹©


**ğŸ”¹ MySQL 8.0å¢å¼ºçš„åŠ å¯†å‡½æ•°ï¼š**

```sql
-- æŒ‡å®šåŠ å¯†æ¨¡å¼ï¼ˆæ¨èï¼‰
SET @key = UNHEX('F3229A0B371ED2D9441B830D21A390C3');
SET @init_vector = RANDOM_BYTES(16);

-- ä½¿ç”¨CBCæ¨¡å¼åŠ å¯†
SELECT AES_ENCRYPT('æ•æ„Ÿæ•°æ®', @key, 'aes-256-cbc', @init_vector) AS encrypted;

-- ä½¿ç”¨GCMæ¨¡å¼ï¼ˆæä¾›å®Œæ•´æ€§éªŒè¯ï¼‰
SELECT AES_ENCRYPT('æ•æ„Ÿæ•°æ®', @key, 'aes-256-gcm', @init_vector) AS encrypted;
```

**ğŸ”¹ åŠ å¯†æ¨¡å¼å¯¹æ¯”ï¼š**

| åŠ å¯†æ¨¡å¼ | å®‰å…¨æ€§ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|--------|------|----------|
| **ECB** | â­â­ | â­â­â­â­ | ä¸æ¨èä½¿ç”¨ |
| **CBC** | â­â­â­â­ | â­â­â­ | ä¸€èˆ¬æ•æ„Ÿæ•°æ® |
| **GCM** | â­â­â­â­â­ | â­â­ | é«˜å®‰å…¨è¦æ±‚ |

### 3.3 å¯†é’¥ç®¡ç†ç­–ç•¥


**ğŸ”’ å¯†é’¥å­˜å‚¨æ–¹æ¡ˆï¼š**

```sql
-- æ–¹æ¡ˆ1ï¼šç¯å¢ƒå˜é‡å¯†é’¥ï¼ˆæ¨èï¼‰
SET @encryption_key = CONCAT(
    USER(), 
    '_', 
    CONNECTION_ID(), 
    '_', 
    $$global.server_uuid
);

-- æ–¹æ¡ˆ2ï¼šå¯†é’¥è¡¨å­˜å‚¨ï¼ˆéœ€è¦é¢å¤–ä¿æŠ¤ï¼‰
CREATE TABLE encryption_keys (
    key_id VARCHAR(32) PRIMARY KEY,
    key_value VARBINARY(256),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP
);
```

**âš ï¸ å¯†é’¥å®‰å…¨æ³¨æ„äº‹é¡¹ï¼š**
> ğŸ”¥ **é‡è¦è­¦å‘Š**
> 
> - å¯†é’¥ä¸èƒ½ç¡¬ç¼–ç åœ¨SQLè¯­å¥ä¸­
> - é¿å…åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•å¯†é’¥ä¿¡æ¯  
> - å®šæœŸè½®æ¢å¯†é’¥å¹¶ä¿ç•™å†å²ç‰ˆæœ¬ç”¨äºè§£å¯†

---

## 4. ğŸ’» åº”ç”¨å±‚åŠ å¯†å®ç°


### 4.1 åº”ç”¨å±‚åŠ å¯†æ¶æ„


**åº”ç”¨å±‚åŠ å¯†**æ˜¯åœ¨ç¨‹åºä»£ç ä¸­å¤„ç†æ•°æ®åŠ è§£å¯†ï¼Œå¯¹æ•°æ®åº“å±‚é€æ˜ã€‚

**ğŸ—ï¸ æ¶æ„è®¾è®¡ï¼š**

```
åº”ç”¨å±‚åŠ å¯†æ•°æ®æµï¼š

ç”¨æˆ·è¾“å…¥ â†’ [åº”ç”¨å±‚åŠ å¯†] â†’ å­˜å‚¨åˆ°æ•°æ®åº“
         â†‘
    åŠ å¯†æœåŠ¡æ¨¡å—
         â†“
æ•°æ®åº“è¯»å– â†’ [åº”ç”¨å±‚è§£å¯†] â†’ è¿”å›ç»™ç”¨æˆ·
```

### 4.2 Javaåº”ç”¨å±‚åŠ å¯†å®ç°


**ğŸ”¹ åŠ å¯†å·¥å…·ç±»ç¤ºä¾‹ï¼š**

```java
public class FieldEncryption {
    private static final String ALGORITHM = "AES/CBC/PKCS5Padding";
    private static final String KEY_SPEC = "AES";
    
    // åŠ å¯†æ•æ„Ÿå­—æ®µ
    public static String encrypt(String plaintext, String key) {
        try {
            SecretKeySpec secretKey = new SecretKeySpec(key.getBytes(), KEY_SPEC);
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            cipher.init(Cipher.ENCRYPT_MODE, secretKey);
            
            byte[] encrypted = cipher.doFinal(plaintext.getBytes());
            return Base64.getEncoder().encodeToString(encrypted);
        } catch (Exception e) {
            throw new RuntimeException("åŠ å¯†å¤±è´¥", e);
        }
    }
    
    // è§£å¯†æ•æ„Ÿå­—æ®µ
    public static String decrypt(String ciphertext, String key) {
        try {
            SecretKeySpec secretKey = new SecretKeySpec(key.getBytes(), KEY_SPEC);
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            cipher.init(Cipher.DECRYPT_MODE, secretKey);
            
            byte[] decrypted = cipher.doFinal(Base64.getDecoder().decode(ciphertext));
            return new String(decrypted);
        } catch (Exception e) {
            throw new RuntimeException("è§£å¯†å¤±è´¥", e);
        }
    }
}
```

### 4.3 ORMæ¡†æ¶é›†æˆ


**ğŸ”¹ MyBatisåŠ å¯†æ’ä»¶ç¤ºä¾‹ï¼š**

```java
@Intercepts({@Signature(type = ParameterHandler.class, method = "setParameters")})
public class EncryptionInterceptor implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        ParameterHandler parameterHandler = (ParameterHandler) invocation.getTarget();
        Field field = parameterHandler.getClass().getDeclaredField("parameterObject");
        field.setAccessible(true);
        
        Object parameterObject = field.get(parameterHandler);
        if (parameterObject != null) {
            // æ‰«æéœ€è¦åŠ å¯†çš„å­—æ®µ
            encryptFields(parameterObject);
        }
        
        return invocation.proceed();
    }
    
    private void encryptFields(Object obj) {
        Field[] fields = obj.getClass().getDeclaredFields();
        for (Field field : fields) {
            if (field.isAnnotationPresent(EncryptField.class)) {
                field.setAccessible(true);
                try {
                    String value = (String) field.get(obj);
                    if (value != null) {
                        String encryptedValue = FieldEncryption.encrypt(value, getKey());
                        field.set(obj, encryptedValue);
                    }
                } catch (Exception e) {
                    // å¤„ç†åŠ å¯†å¼‚å¸¸
                }
            }
        }
    }
}
```

### 4.4 åº”ç”¨é€æ˜åŠ å¯†


**é€æ˜åŠ å¯†**æŒ‡åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨æ•°æ®æ—¶æ— éœ€å…³å¿ƒåŠ è§£å¯†è¿‡ç¨‹ï¼Œç”±ä¸­é—´ä»¶è‡ªåŠ¨å¤„ç†ã€‚

**ğŸ”¹ ä»£ç†æ¨¡å¼å®ç°ï¼š**

```java
public class EncryptionProxy {
    private final DataSource dataSource;
    private final EncryptionConfig config;
    
    public Connection getConnection() throws SQLException {
        Connection conn = dataSource.getConnection();
        return new EncryptionConnectionWrapper(conn, config);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
@Entity
public class User {
    private Long id;
    private String name;
    
    @EncryptField  // è‡ªåŠ¨åŠ å¯†æ³¨è§£
    private String phone;
    
    @EncryptField
    private String email;
    
    // getter/setter...
}
```

---

## 5. ğŸ” åŠ å¯†å­—æ®µç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–


### 5.1 åŠ å¯†å­—æ®µç´¢å¼•é—®é¢˜


**åŠ å¯†æ•°æ®çš„ç´¢å¼•æŒ‘æˆ˜**ï¼šä¼ ç»ŸB-Treeç´¢å¼•æ— æ³•å¯¹åŠ å¯†æ•°æ®å»ºç«‹æœ‰æ•ˆç´¢å¼•ã€‚

**ğŸ”¹ é—®é¢˜åˆ†æï¼š**

```
åŸå§‹æ•°æ®ï¼š['apple', 'banana', 'cherry']
B-Treeç´¢å¼•ï¼ša < b < c ï¼ˆæœ‰åºï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼‰

åŠ å¯†æ•°æ®ï¼š['xK9mP...', 'mN7qR...', 'pL8wT...']  
åŠ å¯†ç´¢å¼•ï¼šæ— è§„å¾‹ ï¼ˆæ— åºï¼Œæ— æ³•æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼‰

å½±å“ï¼š
âŒ æ— æ³•ä½¿ç”¨WHEREå­å¥è¿›è¡Œç­‰å€¼æŸ¥è¯¢
âŒ æ— æ³•ä½¿ç”¨LIKEè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢  
âŒ æ— æ³•ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ï¼ˆ>, <, BETWEENï¼‰
âŒ æŸ¥è¯¢æ€§èƒ½å¤§å¹…ä¸‹é™
```

### 5.2 å¯æœç´¢åŠ å¯†æ–¹æ¡ˆ


**ğŸ”¹ æ–¹æ¡ˆ1ï¼šå“ˆå¸Œç´¢å¼•è¾…åŠ©**

```sql
-- ä¸ºåŠ å¯†å­—æ®µåˆ›å»ºå“ˆå¸Œç´¢å¼•åˆ—
ALTER TABLE users ADD COLUMN phone_hash VARCHAR(64);

-- æ’å…¥æ—¶åŒæ—¶è®¡ç®—å“ˆå¸Œå€¼
INSERT INTO users (name, phone_encrypted, phone_hash) 
VALUES (
    'å¼ ä¸‰',
    AES_ENCRYPT('13800138000', @key),
    SHA2('13800138000', 256)
);

-- æŸ¥è¯¢æ—¶ä½¿ç”¨å“ˆå¸Œå€¼å®šä½
SELECT name, AES_DECRYPT(phone_encrypted, @key) AS phone
FROM users 
WHERE phone_hash = SHA2('13800138000', 256);
```

**ğŸ”¹ æ–¹æ¡ˆ2ï¼šéƒ¨åˆ†åŠ å¯†ç­–ç•¥**

```sql
-- ä¿ç•™éƒ¨åˆ†æ˜æ–‡ç”¨äºç´¢å¼•å’Œæœç´¢
CREATE TABLE users (
    id BIGINT PRIMARY KEY,
    name VARCHAR(50),
    phone_prefix VARCHAR(3),      -- å‰3ä½æ˜æ–‡ï¼Œç”¨äºç´¢å¼•
    phone_encrypted VARBINARY(256), -- å®Œæ•´åŠ å¯†
    email_domain VARCHAR(50),     -- åŸŸåæ˜æ–‡ï¼Œç”¨äºç»Ÿè®¡
    email_encrypted VARBINARY(256)  -- å®Œæ•´åŠ å¯†
);

-- åˆ›å»ºç»„åˆç´¢å¼•
CREATE INDEX idx_phone_prefix ON users(phone_prefix);
CREATE INDEX idx_email_domain ON users(email_domain);
```

### 5.3 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼š**

```sql
-- 1. ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨
CREATE INDEX idx_user_cover ON users(phone_hash, id, phone_encrypted);

-- 2. æ‰¹é‡è§£å¯†å‡å°‘å‡½æ•°è°ƒç”¨
SELECT 
    id,
    name,
    CASE 
        WHEN @decrypt_mode = 1 THEN AES_DECRYPT(phone_encrypted, @key)
        ELSE '***'
    END AS phone
FROM users
WHERE phone_hash IN (
    SHA2('13800138000', 256),
    SHA2('13900139000', 256)
);

-- 3. ä½¿ç”¨è§†å›¾ç®€åŒ–å¤æ‚æŸ¥è¯¢
CREATE VIEW user_decrypted AS
SELECT 
    id,
    name,
    AES_DECRYPT(phone_encrypted, @encryption_key) AS phone,
    AES_DECRYPT(email_encrypted, @encryption_key) AS email
FROM users;
```

**ğŸ“Š æ€§èƒ½å½±å“è¯„ä¼°ï¼š**

| æ“ä½œç±»å‹ | æœªåŠ å¯†æ€§èƒ½ | åŠ å¯†åæ€§èƒ½ | æ€§èƒ½ä¸‹é™ |
|---------|-----------|-----------|----------|
| æ’å…¥æ“ä½œ | 100% | 85% | 15% â¬‡ï¸ |
| ç­‰å€¼æŸ¥è¯¢ | 100% | 60% | 40% â¬‡ï¸ |
| èŒƒå›´æŸ¥è¯¢ | 100% | 10% | 90% â¬‡ï¸ |
| èšåˆç»Ÿè®¡ | 100% | 5% | 95% â¬‡ï¸ |

---

## 6. ğŸš€ é«˜çº§åŠ å¯†æŠ€æœ¯åº”ç”¨


### 6.1 æ ¼å¼ä¿ç•™åŠ å¯†ï¼ˆFPEï¼‰


**æ ¼å¼ä¿ç•™åŠ å¯†**èƒ½å¤Ÿä¿æŒåŠ å¯†åæ•°æ®çš„æ ¼å¼ä¸åŸæ•°æ®ç›¸åŒï¼Œä¾¿äºç³»ç»Ÿå…¼å®¹ã€‚

**ğŸ”¹ åº”ç”¨åœºæ™¯ï¼š**
```
åŸå§‹ä¿¡ç”¨å¡å·ï¼š4532-1234-5678-9012
FPEåŠ å¯†åï¼š  4532-8765-2143-7890
           â†‘
       ä¿æŒç›¸åŒæ ¼å¼ï¼Œé•¿åº¦ä¸å˜
```

**ğŸ”¹ å®ç°åŸç†ï¼š**
```
FPEåŠ å¯†è¿‡ç¨‹ï¼š
è¾“å…¥æ•°æ® â†’ æ ¼å¼åˆ†æ â†’ åŠ å¯†å˜æ¢ â†’ æ ¼å¼é‡ç»„ â†’ è¾“å‡ºå¯†æ–‡
    â†“           â†“          â†“          â†“
16ä½æ•°å­— â†’ [4ä½-4ä½-4ä½-4ä½] â†’ AESåŠ å¯† â†’ é‡æ–°ç»„åˆ â†’ 16ä½æ•°å­—å¯†æ–‡
```

### 6.2 åŒæ€åŠ å¯†æŠ€æœ¯


**åŒæ€åŠ å¯†**å…è®¸åœ¨ä¸è§£å¯†çš„æƒ…å†µä¸‹å¯¹å¯†æ–‡è¿›è¡Œè®¡ç®—æ“ä½œã€‚

**ğŸ”¹ åº”ç”¨ç¤ºä¾‹ï¼š**
```sql
-- ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦è§£å¯†åè®¡ç®—
SELECT SUM(AES_DECRYPT(salary_encrypted, @key)) 
FROM employees;

-- åŒæ€åŠ å¯†ï¼šç›´æ¥å¯¹å¯†æ–‡è®¡ç®—ï¼ˆç†è®ºç¤ºä¾‹ï¼‰
SELECT HOMOMORPHIC_SUM(salary_encrypted) 
FROM employees;
```

**ğŸ”¹ å®é™…åº”ç”¨é™åˆ¶ï¼š**
> ğŸ’¡ **æŠ€æœ¯è¯´æ˜**
> 
> ç›®å‰åŒæ€åŠ å¯†ä¸»è¦ç”¨äºäº‘è®¡ç®—å’Œè”é‚¦å­¦ä¹ åœºæ™¯ï¼ŒMySQLåŸç”Ÿä¸æ”¯æŒã€‚
> å®é™…åº”ç”¨ä¸­æ›´å¤šä½¿ç”¨å®‰å…¨å¤šæ–¹è®¡ç®—ï¼ˆSMCï¼‰åè®®ã€‚

### 6.3 ç«¯åˆ°ç«¯åŠ å¯†ï¼ˆE2Eï¼‰


**ç«¯åˆ°ç«¯åŠ å¯†**ç¡®ä¿æ•°æ®ä»å®¢æˆ·ç«¯åˆ°å­˜å‚¨çš„å…¨ç¨‹åŠ å¯†ä¿æŠ¤ã€‚

**ğŸ”¹ æ¶æ„è®¾è®¡ï¼š**
```
E2EåŠ å¯†æ•°æ®æµï¼š

å®¢æˆ·ç«¯ â†’ [å®¢æˆ·ç«¯åŠ å¯†] â†’ ç½‘ç»œä¼ è¾“ â†’ [æœåŠ¡ç«¯å­˜å‚¨] â†’ æ•°æ®åº“
   â†‘                                                    â†“
å¯†é’¥ç®¡ç†                                           å¯†æ–‡å­˜å‚¨
   â†“                                                    â†‘  
å®¢æˆ·ç«¯ â† [å®¢æˆ·ç«¯è§£å¯†] â† ç½‘ç»œä¼ è¾“ â† [æœåŠ¡ç«¯è¿”å›] â† æ•°æ®åº“
```

**ğŸ”¹ å¯†é’¥åˆ†å‘æ–¹æ¡ˆï¼š**
```javascript
// å®¢æˆ·ç«¯å¯†é’¥ç”Ÿæˆç¤ºä¾‹
class E2EEncryption {
    constructor() {
        this.userKey = this.generateUserKey();
        this.publicKey = this.getUserPublicKey();
    }
    
    encryptField(data) {
        // ä½¿ç”¨ç”¨æˆ·å¯†é’¥åŠ å¯†
        return AES.encrypt(data, this.userKey);
    }
    
    submitToServer(encryptedData) {
        // æäº¤å·²åŠ å¯†æ•°æ®åˆ°æœåŠ¡å™¨
        return fetch('/api/user', {
            method: 'POST',
            body: JSON.stringify({encrypted: encryptedData})
        });
    }
}
```

---

## 7. âš™ï¸ åŠ å¯†å®æ–½ç­–ç•¥ä¸æœ€ä½³å®è·µ


### 7.1 åŠ å¯†ç­–ç•¥åˆ¶å®š


**ğŸ”¹ å®æ–½æ­¥éª¤ï¼š**

```
åŠ å¯†é¡¹ç›®å®æ–½æµç¨‹ï¼š

1ï¸âƒ£ æ•°æ®åˆ†ç±»åˆ†çº§
â”œâ”€ è¯†åˆ«æ•æ„Ÿå­—æ®µ
â”œâ”€ è¯„ä¼°é£é™©çº§åˆ«  
â””â”€ åˆ¶å®šä¿æŠ¤ç­–ç•¥

2ï¸âƒ£ æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡
â”œâ”€ é€‰æ‹©åŠ å¯†ç®—æ³•
â”œâ”€ è®¾è®¡å¯†é’¥ç®¡ç†
â””â”€ è§„åˆ’æ€§èƒ½ä¼˜åŒ–

3ï¸âƒ£ é€æ­¥å®æ–½éƒ¨ç½²
â”œâ”€ æ–°æ•°æ®åŠ å¯†å­˜å‚¨
â”œâ”€ å†å²æ•°æ®è¿ç§»
â””â”€ åº”ç”¨ç¨‹åºé€‚é…

4ï¸âƒ£ ç›‘æ§ä¸ç»´æŠ¤
â”œâ”€ æ€§èƒ½ç›‘æ§
â”œâ”€ å®‰å…¨å®¡è®¡
â””â”€ å¯†é’¥è½®æ¢
```

### 7.2 å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ


**ğŸ”’ ä¼ä¸šçº§å¯†é’¥ç®¡ç†ï¼š**

```sql
-- å¯†é’¥ç‰ˆæœ¬ç®¡ç†è¡¨
CREATE TABLE encryption_key_versions (
    key_id VARCHAR(32),
    version INT,
    key_value VARBINARY(256),
    algorithm VARCHAR(50),
    created_at TIMESTAMP,
    expires_at TIMESTAMP,
    status ENUM('active', 'retired', 'compromised'),
    PRIMARY KEY (key_id, version)
);

-- æ•°æ®è¡¨å¢åŠ å¯†é’¥ç‰ˆæœ¬å­—æ®µ
ALTER TABLE users ADD COLUMN key_version INT DEFAULT 1;

-- æ”¯æŒå¤šç‰ˆæœ¬è§£å¯†
CREATE FUNCTION decrypt_with_version(
    encrypted_data VARBINARY(1024),
    key_version INT
) RETURNS TEXT
READS SQL DATA
BEGIN
    DECLARE key_value VARBINARY(256);
    
    SELECT k.key_value INTO key_value
    FROM encryption_key_versions k
    WHERE k.key_id = 'user_data_key' 
    AND k.version = key_version
    AND k.status = 'active';
    
    RETURN AES_DECRYPT(encrypted_data, key_value);
END;
```

### 7.3 åŠ å¯†é…ç½®ç®¡ç†


**ğŸ”§ é…ç½®ç®¡ç†ç­–ç•¥ï¼š**

```yaml
# åŠ å¯†é…ç½®æ–‡ä»¶ç¤ºä¾‹
encryption:
  default_algorithm: "AES-256-CBC"
  key_rotation_days: 90
  
  fields:
    users.phone:
      algorithm: "AES-256-CBC" 
      searchable: true
      format_preserving: false
      
    users.id_card:
      algorithm: "AES-256-GCM"
      searchable: false  
      format_preserving: true
      
    orders.amount:
      algorithm: "Homomorphic"
      aggregatable: true
      
  performance:
    batch_size: 1000
    cache_decrypted: false
    index_strategy: "hash_auxiliary"
```

### 7.4 å¼‚å¸¸å¤„ç†ä¸æ¢å¤


**ğŸš¨ å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼š**

```java
public class EncryptionExceptionHandler {
    
    public String safeDecrypt(String encryptedData, String keyId) {
        try {
            return decrypt(encryptedData, keyId);
        } catch (InvalidKeyException e) {
            // å¯†é’¥å¤±æ•ˆï¼Œå°è¯•å†å²ç‰ˆæœ¬
            return retryWithHistoricalKeys(encryptedData);
        } catch (CorruptedDataException e) {
            // æ•°æ®æŸåï¼Œè®°å½•æ—¥å¿—å¹¶è¿”å›æ ‡è¯†
            logCorruptedData(encryptedData);
            return "[æ•°æ®æŸå]";
        } catch (Exception e) {
            // å…¶ä»–å¼‚å¸¸ï¼Œè¿”å›å®‰å…¨çš„é»˜è®¤å€¼
            return "[è§£å¯†å¤±è´¥]";
        }
    }
    
    private String retryWithHistoricalKeys(String data) {
        // å°è¯•å†å²å¯†é’¥ç‰ˆæœ¬è§£å¯†
        for (int version = getCurrentKeyVersion(); version >= 1; version--) {
            try {
                return decryptWithVersion(data, version);
            } catch (Exception ignored) {
                continue;
            }
        }
        throw new DecryptionFailedException("æ‰€æœ‰å¯†é’¥ç‰ˆæœ¬å‡æ— æ³•è§£å¯†");
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å­—æ®µçº§åŠ å¯†ï¼šå¯¹ç‰¹å®šæ•æ„Ÿå­—æ®µè¿›è¡Œé€‰æ‹©æ€§åŠ å¯†ä¿æŠ¤
ğŸ”¸ æ•æ„Ÿæ•°æ®åˆ†çº§ï¼šæ ¹æ®é£é™©çº§åˆ«é‡‡ç”¨ä¸åŒå¼ºåº¦çš„åŠ å¯†ç­–ç•¥  
ğŸ”¸ MySQLå†…ç½®å‡½æ•°ï¼šAES_ENCRYPT/AES_DECRYPTçš„æ­£ç¡®ä½¿ç”¨æ–¹æ³•
ğŸ”¸ åº”ç”¨å±‚åŠ å¯†ï¼šåœ¨ç¨‹åºä¸­å®ç°æ•°æ®åŠ è§£å¯†çš„é€æ˜å¤„ç†
ğŸ”¸ ç´¢å¼•ä¼˜åŒ–ï¼šè§£å†³åŠ å¯†å­—æ®µæŸ¥è¯¢æ€§èƒ½é—®é¢˜çš„å¤šç§æ–¹æ¡ˆ
ğŸ”¸ å¯†é’¥ç®¡ç†ï¼šä¼ä¸šçº§å¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ åŠ å¯†ç­–ç•¥é€‰æ‹©åŸåˆ™**
```
é€‰æ‹©æ ‡å‡†ï¼š
âœ… æ•°æ®æ•æ„Ÿç¨‹åº¦ â†’ å†³å®šåŠ å¯†å¼ºåº¦
âœ… æŸ¥è¯¢éœ€æ±‚ â†’ å†³å®šæ˜¯å¦éœ€è¦å¯æœç´¢åŠ å¯†  
âœ… æ€§èƒ½è¦æ±‚ â†’ å†³å®šåŠ å¯†å®ç°å±‚çº§
âœ… åˆè§„è¦æ±‚ â†’ å†³å®šå¯†é’¥ç®¡ç†ç­–ç•¥
```

**ğŸ”¹ æ€§èƒ½ä¸å®‰å…¨çš„å¹³è¡¡**
```
å¹³è¡¡ç­–ç•¥ï¼š
ğŸ“Š æ ¸å¿ƒæ•æ„Ÿå­—æ®µï¼šå¼ºåŠ å¯† + æ€§èƒ½ä¼˜åŒ–
ğŸ“Š ä¸€èˆ¬æ•æ„Ÿå­—æ®µï¼šæ ‡å‡†åŠ å¯† + ç´¢å¼•è¾…åŠ©  
ğŸ“Š ä½æ•æ„Ÿå­—æ®µï¼šå¯é€‰åŠ å¯† + æ‰¹é‡å¤„ç†
```

**ğŸ”¹ å®æ–½é£é™©æ§åˆ¶**
```
é£é™©ç¼“è§£ï¼š
ğŸ›¡ï¸ æ¸è¿›å¼éƒ¨ç½²ï¼šå…ˆæ–°æ•°æ®åå†å²æ•°æ®
ğŸ›¡ï¸ å¤šç‰ˆæœ¬å…¼å®¹ï¼šæ”¯æŒå¯†é’¥è½®æ¢å’Œç®—æ³•å‡çº§
ğŸ›¡ï¸ å¼‚å¸¸æ¢å¤ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ•°æ®æ¢å¤æœºåˆ¶
ğŸ›¡ï¸ ç›‘æ§å®¡è®¡ï¼šå…¨é¢çš„æ“ä½œæ—¥å¿—å’Œå®‰å…¨å®¡è®¡
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å®æ–½ä¼˜å…ˆçº§**
```
ç¬¬ä¸€é˜¶æ®µï¼šèº«ä»½è¯å·ã€é“¶è¡Œå¡å·ç­‰æ³•å®šæ•æ„Ÿä¿¡æ¯
ç¬¬äºŒé˜¶æ®µï¼šæ‰‹æœºå·ã€é‚®ç®±ç­‰è”ç³»æ–¹å¼ä¿¡æ¯  
ç¬¬ä¸‰é˜¶æ®µï¼šåœ°å€ã€åå¥½ç­‰ä¸ªäººéšç§ä¿¡æ¯
ç¬¬å››é˜¶æ®µï¼šè¡Œä¸ºæ•°æ®ç­‰å…¶ä»–æ•æ„Ÿä¿¡æ¯
```

**ğŸ”§ æŠ€æœ¯é€‰å‹å»ºè®®**
```
å°å‹ç³»ç»Ÿï¼šMySQLå†…ç½®å‡½æ•° + ç®€å•å¯†é’¥ç®¡ç†
ä¸­å‹ç³»ç»Ÿï¼šåº”ç”¨å±‚åŠ å¯† + ORMé›†æˆ + é…ç½®åŒ–ç®¡ç†
å¤§å‹ç³»ç»Ÿï¼šä¸­é—´ä»¶é€æ˜åŠ å¯† + ä¸“ä¸šå¯†é’¥ç®¡ç† + åˆè§„å®¡è®¡
```

**âš ï¸ å¸¸è§é™·é˜±é¿å…**
```
âŒ å¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
âŒ æ‰€æœ‰å­—æ®µä½¿ç”¨ç›¸åŒå¯†é’¥
âŒ å¿½ç•¥åŠ å¯†å­—æ®µçš„ç´¢å¼•ä¼˜åŒ–
âŒ ç¼ºä¹å¯†é’¥è½®æ¢å’Œç‰ˆæœ¬ç®¡ç†
âŒ æ²¡æœ‰è€ƒè™‘å†å²æ•°æ®è¿ç§»æ–¹æ¡ˆ
```

### 8.4 å­¦ä¹ æ£€æŸ¥æ¸…å•


**ğŸ“‹ æŒæ¡ç¨‹åº¦è‡ªæ£€ï¼š**

- [x] ç†è§£å­—æ®µçº§åŠ å¯†çš„åŸºæœ¬æ¦‚å¿µå’Œåº”ç”¨åœºæ™¯
- [x] èƒ½å¤Ÿè¯†åˆ«å’Œåˆ†ç±»æ•æ„Ÿæ•°æ®å­—æ®µ
- [x] æŒæ¡MySQL AES_ENCRYPTå‡½æ•°çš„ä½¿ç”¨æ–¹æ³•
- [ ] ä¼šè®¾è®¡åº”ç”¨å±‚åŠ å¯†çš„æ¶æ„æ–¹æ¡ˆ
- [ ] èƒ½è§£å†³åŠ å¯†å­—æ®µçš„ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–é—®é¢˜
- [ ] äº†è§£é«˜çº§åŠ å¯†æŠ€æœ¯ï¼ˆFPEã€åŒæ€åŠ å¯†ï¼‰çš„åº”ç”¨
- [ ] ä¼šåˆ¶å®šå®Œæ•´çš„åŠ å¯†å®æ–½å’Œç®¡ç†ç­–ç•¥

**ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘ï¼š**
- æ·±å…¥å­¦ä¹ å¯†ç å­¦åŸºç¡€ç†è®º
- ç ”ç©¶é›¶çŸ¥è¯†è¯æ˜ç­‰å‰æ²¿åŠ å¯†æŠ€æœ¯
- å®è·µå¤§è§„æ¨¡æ•°æ®åŠ å¯†é¡¹ç›®
- å­¦ä¹ ç›¸å…³æ³•è§„å’Œåˆè§„è¦æ±‚

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> *"æ•æ„Ÿæ•°æ®è¦åˆ†çº§ï¼Œå­—æ®µåŠ å¯†éœ€ç­–ç•¥ï¼›å¯†é’¥ç®¡ç†æ˜¯æ ¸å¿ƒï¼Œæ€§èƒ½å®‰å…¨è¦å¹³è¡¡"*