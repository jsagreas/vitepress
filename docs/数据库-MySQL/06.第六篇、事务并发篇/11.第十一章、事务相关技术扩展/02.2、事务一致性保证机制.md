---
title: 2ã€äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [äº‹åŠ¡ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ](#1-äº‹åŠ¡ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ)
2. [ä¸€è‡´æ€§æ£€æŸ¥ç®—æ³•](#2-ä¸€è‡´æ€§æ£€æŸ¥ç®—æ³•)
3. [çº¦æŸéªŒè¯æœºåˆ¶](#3-çº¦æŸéªŒè¯æœºåˆ¶)
4. [ä¸€è‡´æ€§ä¿®å¤ç­–ç•¥](#4-ä¸€è‡´æ€§ä¿®å¤ç­–ç•¥)
5. [ä¸€è‡´æ€§ç›‘æ§æŒ‡æ ‡](#5-ä¸€è‡´æ€§ç›‘æ§æŒ‡æ ‡)
6. [ä¸€è‡´æ€§æ•…éšœå¤„ç†](#6-ä¸€è‡´æ€§æ•…éšœå¤„ç†)
7. [ä¸€è‡´æ€§ä¿è¯å®Œæ•´æœºåˆ¶](#7-ä¸€è‡´æ€§ä¿è¯å®Œæ•´æœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ äº‹åŠ¡ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ä¸€è‡´æ€§


äº‹åŠ¡ä¸€è‡´æ€§æ˜¯æ•°æ®åº“ACIDç‰¹æ€§ä¸­çš„Cï¼ˆConsistencyï¼‰ï¼Œç®€å•è¯´å°±æ˜¯**ç¡®ä¿æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰åéƒ½ä¿æŒæ­£ç¡®çš„çŠ¶æ€**ã€‚

**é€šä¿—ç†è§£**ï¼š
- å°±åƒé“¶è¡Œè½¬è´¦ï¼Œä»Aè´¦æˆ·è½¬å‡º100å…ƒåˆ°Bè´¦æˆ·ï¼Œå¿…é¡»ä¿è¯Aå‡100ï¼ŒBåŠ 100ï¼Œä¸èƒ½å‡ºç°é’±å‡­ç©ºæ¶ˆå¤±æˆ–å¢åŠ çš„æƒ…å†µ
- æ•°æ®åº“çš„æ‰€æœ‰çº¦æŸï¼ˆä¸»é”®ã€å¤–é”®ã€æ£€æŸ¥çº¦æŸç­‰ï¼‰åœ¨äº‹åŠ¡å‰åéƒ½å¿…é¡»æ»¡è¶³

```
è½¬è´¦å‰ï¼šAè´¦æˆ·=1000ï¼ŒBè´¦æˆ·=500ï¼Œæ€»é¢=1500
è½¬è´¦ä¸­ï¼šä¸´æ—¶çŠ¶æ€å¯èƒ½ä¸ä¸€è‡´ï¼ˆA=900ï¼ŒB=500ï¼‰
è½¬è´¦åï¼šAè´¦æˆ·=900ï¼ŒBè´¦æˆ·=600ï¼Œæ€»é¢=1500 âœ“
```

### 1.2 ä¸€è‡´æ€§çš„å±‚æ¬¡åˆ’åˆ†


**æ•°æ®ä¸€è‡´æ€§å±‚æ¬¡**ï¼š
```
ç‰©ç†ä¸€è‡´æ€§ï¼šæ•°æ®æ–‡ä»¶å®Œæ•´ï¼Œæ²¡æœ‰æŸå
  â†“
é€»è¾‘ä¸€è‡´æ€§ï¼šæ•°æ®ç¬¦åˆä¸šåŠ¡è§„åˆ™å’Œçº¦æŸ
  â†“  
è¯­ä¹‰ä¸€è‡´æ€§ï¼šæ•°æ®å«ä¹‰æ­£ç¡®ï¼Œä¸šåŠ¡é€»è¾‘æ­£ç¡®
  â†“
åº”ç”¨ä¸€è‡´æ€§ï¼šå¤šä¸ªç›¸å…³æ“ä½œä¿æŒæ•´ä½“ä¸€è‡´
```

### 1.3 ä¸€è‡´æ€§ä¸å…¶ä»–ACIDç‰¹æ€§çš„å…³ç³»


**ACIDç‰¹æ€§åä½œ**ï¼š
- **åŸå­æ€§ï¼ˆAï¼‰**ï¼šä¸ºä¸€è‡´æ€§æä¾›åŸºç¡€ï¼Œè¦ä¹ˆå…¨åšè¦ä¹ˆå…¨ä¸åš
- **ä¸€è‡´æ€§ï¼ˆCï¼‰**ï¼šæ ¸å¿ƒç›®æ ‡ï¼Œç¡®ä¿æ•°æ®æ­£ç¡®æ€§
- **éš”ç¦»æ€§ï¼ˆIï¼‰**ï¼šé˜²æ­¢å¹¶å‘äº‹åŠ¡ç ´åä¸€è‡´æ€§
- **æŒä¹…æ€§ï¼ˆDï¼‰**ï¼šç¡®ä¿ä¸€è‡´çš„ç»“æœæ°¸ä¹…ä¿å­˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åŸå­æ€§     â”‚â”€â”€â”€â†’â”‚   ä¸€è‡´æ€§     â”‚
â”‚ (All or None)â”‚    â”‚ (Correctness)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘                   â†‘
       â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æŒä¹…æ€§     â”‚â†â”€â”€â”€â”‚   éš”ç¦»æ€§     â”‚
â”‚(Durability) â”‚    â”‚ (Isolation) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ” ä¸€è‡´æ€§æ£€æŸ¥ç®—æ³•


### 2.1 æ£€æŸ¥ç®—æ³•çš„ä½œç”¨


ä¸€è‡´æ€§æ£€æŸ¥ç®—æ³•å°±åƒæ•°æ®åº“çš„"ä½“æ£€åŒ»ç”Ÿ"ï¼Œå®šæœŸæˆ–å®æ—¶æ£€æŸ¥æ•°æ®æ˜¯å¦è¿˜ç¬¦åˆæ‰€æœ‰çš„è§„åˆ™å’Œçº¦æŸã€‚

**æ£€æŸ¥æ—¶æœº**ï¼š
- **äº‹åŠ¡æäº¤å‰**ï¼šç¡®ä¿æäº¤çš„æ•°æ®ç¬¦åˆçº¦æŸ
- **å®šæœŸæ£€æŸ¥**ï¼šå‘ç°æ•°æ®æ¼‚ç§»æˆ–æŸå
- **æ•…éšœæ¢å¤å**ï¼šéªŒè¯æ•°æ®å®Œæ•´æ€§

### 2.2 ä¸»è¦æ£€æŸ¥ç®—æ³•ç±»å‹


#### ğŸ“‹ çº¦æŸä¸€è‡´æ€§æ£€æŸ¥


**ä¸»é”®å”¯ä¸€æ€§æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥ä¸»é”®é‡å¤
SELECT id, COUNT(*) 
FROM users 
GROUP BY id 
HAVING COUNT(*) > 1;

-- æ£€æŸ¥ä¸»é”®ä¸ºç©º
SELECT COUNT(*) 
FROM users 
WHERE id IS NULL;
```

**å¤–é”®å¼•ç”¨å®Œæ•´æ€§æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥å­¤å„¿è®°å½•ï¼ˆå¤–é”®æŒ‡å‘ä¸å­˜åœ¨çš„è®°å½•ï¼‰
SELECT o.* 
FROM orders o 
LEFT JOIN users u ON o.user_id = u.id 
WHERE u.id IS NULL;

-- æ£€æŸ¥å¼•ç”¨è®¡æ•°
SELECT u.id, u.name, COUNT(o.id) as order_count
FROM users u 
LEFT JOIN orders o ON u.id = o.user_id 
GROUP BY u.id;
```

#### ğŸ“Š æ•°æ®èŒƒå›´æ£€æŸ¥


**ä¸šåŠ¡è§„åˆ™éªŒè¯**ï¼š
```sql
-- æ£€æŸ¥å¹´é¾„åˆç†æ€§
SELECT * FROM users 
WHERE age < 0 OR age > 150;

-- æ£€æŸ¥é‡‘é¢åˆç†æ€§  
SELECT * FROM orders 
WHERE amount <= 0 OR amount > 1000000;

-- æ£€æŸ¥æ—¥æœŸé€»è¾‘
SELECT * FROM orders 
WHERE created_date > shipped_date;
```

### 2.3 å¢é‡æ£€æŸ¥ç®—æ³•


ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒMySQLä½¿ç”¨å¢é‡æ£€æŸ¥ï¼Œåªæ£€æŸ¥å‘ç”Ÿå˜åŒ–çš„æ•°æ®ã€‚

**å˜æ›´æ—¥å¿—è·Ÿè¸ª**ï¼š
```sql
-- åˆ›å»ºå®¡è®¡è¡¨è®°å½•å˜æ›´
CREATE TABLE user_audit (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    operation ENUM('INSERT', 'UPDATE', 'DELETE'),
    old_data JSON,
    new_data JSON,
    change_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- è§¦å‘å™¨è‡ªåŠ¨è®°å½•å˜æ›´
DELIMITER //
CREATE TRIGGER user_audit_trigger
AFTER UPDATE ON users
FOR EACH ROW
BEGIN
    INSERT INTO user_audit (user_id, operation, old_data, new_data)
    VALUES (NEW.id, 'UPDATE', 
            JSON_OBJECT('name', OLD.name, 'email', OLD.email),
            JSON_OBJECT('name', NEW.name, 'email', NEW.email));
END//
DELIMITER ;
```

---

## 3. âœ… çº¦æŸéªŒè¯æœºåˆ¶


### 3.1 çº¦æŸéªŒè¯çš„æœ¬è´¨


çº¦æŸéªŒè¯å°±åƒç»™æ•°æ®åº“è®¾ç½®"è§„åˆ™æ¸…å•"ï¼Œæ¯æ¬¡æ•°æ®å˜æ›´éƒ½è¦æ£€æŸ¥æ˜¯å¦è¿åäº†è¿™äº›è§„åˆ™ã€‚

**å¸¸è§çº¦æŸç±»å‹**ï¼š
```
NOT NULL    â†’ å­—æ®µä¸èƒ½ä¸ºç©º
UNIQUE      â†’ å­—æ®µå€¼å¿…é¡»å”¯ä¸€  
PRIMARY KEY â†’ ä¸»é”®çº¦æŸï¼ˆNOT NULL + UNIQUEï¼‰
FOREIGN KEY â†’ å¤–é”®å¼•ç”¨çº¦æŸ
CHECK       â†’ è‡ªå®šä¹‰æ£€æŸ¥çº¦æŸ
```

### 3.2 çº¦æŸéªŒè¯æ—¶æœº


**ç«‹å³éªŒè¯ vs å»¶è¿ŸéªŒè¯**ï¼š

```sql
-- ç«‹å³éªŒè¯ï¼ˆé»˜è®¤ï¼‰ï¼šæ¯æ¡SQLç«‹å³æ£€æŸ¥
INSERT INTO users (id, email) VALUES (1, 'test@email.com');
-- å¦‚æœemailå·²å­˜åœ¨ï¼Œç«‹å³æŠ¥é”™

-- å»¶è¿ŸéªŒè¯ï¼šäº‹åŠ¡ç»“æŸæ—¶ç»Ÿä¸€æ£€æŸ¥
SET foreign_key_checks = 0;  -- ä¸´æ—¶å…³é—­å¤–é”®æ£€æŸ¥
-- æ‰§è¡Œå¯èƒ½è¿åå¤–é”®çš„æ“ä½œ
INSERT INTO orders (user_id) VALUES (999);  -- ç”¨æˆ·999ä¸å­˜åœ¨
-- ç¨åæ’å…¥ç”¨æˆ·999æˆ–åˆ é™¤è®¢å•
SET foreign_key_checks = 1;  -- é‡æ–°å¼€å¯æ£€æŸ¥
```

### 3.3 çº¦æŸéªŒè¯çš„å®ç°æœºåˆ¶


#### ğŸ”’ è¡Œçº§éªŒè¯


æ¯æ¬¡æ’å…¥æˆ–æ›´æ–°è¡Œæ—¶ç«‹å³éªŒè¯ï¼š
```sql
-- åˆ›å»ºå¸¦çº¦æŸçš„è¡¨
CREATE TABLE products (
    id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) CHECK (price > 0),
    category_id INT,
    FOREIGN KEY (category_id) REFERENCES categories(id)
);

-- æ’å…¥æ—¶è‡ªåŠ¨éªŒè¯æ‰€æœ‰çº¦æŸ
INSERT INTO products VALUES (1, 'iPhone', 999.99, 1);
```

#### ğŸ“‹ è¡¨çº§éªŒè¯


æ¶‰åŠå¤šè¡Œæˆ–å¤šè¡¨çš„å¤æ‚çº¦æŸï¼š
```sql
-- åº“å­˜æ€»æ•°çº¦æŸæ£€æŸ¥
DELIMITER //
CREATE TRIGGER check_inventory_limit
BEFORE INSERT ON inventory
FOR EACH ROW
BEGIN
    DECLARE total_qty INT;
    SELECT SUM(quantity) INTO total_qty 
    FROM inventory 
    WHERE product_id = NEW.product_id;
    
    IF (total_qty + NEW.quantity) > 10000 THEN
        SIGNAL SQLSTATE '45000' 
        SET MESSAGE_TEXT = 'åº“å­˜æ€»é‡è¶…è¿‡é™åˆ¶';
    END IF;
END//
DELIMITER ;
```

### 3.4 çº¦æŸéªŒè¯ä¼˜åŒ–ç­–ç•¥


**æ‰¹é‡éªŒè¯ä¼˜åŒ–**ï¼š
```sql
-- ä½¿ç”¨äº‹åŠ¡æ‰¹é‡æ’å…¥ï¼Œå‡å°‘çº¦æŸæ£€æŸ¥æ¬¡æ•°
START TRANSACTION;
SET unique_checks = 0;      -- ä¸´æ—¶å…³é—­å”¯ä¸€æ€§æ£€æŸ¥
SET foreign_key_checks = 0; -- ä¸´æ—¶å…³é—­å¤–é”®æ£€æŸ¥

-- æ‰¹é‡æ’å…¥æ•°æ®
INSERT INTO users VALUES 
    (1, 'user1', 'user1@email.com'),
    (2, 'user2', 'user2@email.com'),
    (3, 'user3', 'user3@email.com');

SET unique_checks = 1;      -- é‡æ–°å¼€å¯æ£€æŸ¥
SET foreign_key_checks = 1;
COMMIT;  -- æäº¤æ—¶è¿›è¡Œå®Œæ•´éªŒè¯
```

---

## 4. ğŸ”§ ä¸€è‡´æ€§ä¿®å¤ç­–ç•¥


### 4.1 ä¿®å¤ç­–ç•¥æ¦‚è¿°


å½“å‘ç°æ•°æ®ä¸ä¸€è‡´æ—¶ï¼Œéœ€è¦é‡‡ç”¨åˆé€‚çš„ç­–ç•¥è¿›è¡Œä¿®å¤ï¼Œå°±åƒåŒ»ç”Ÿæ²»ç—…è¦é€‰æ‹©åˆé€‚çš„æ²»ç–—æ–¹æ¡ˆã€‚

**ä¿®å¤ç­–ç•¥åˆ†ç±»**ï¼š
```
è‡ªåŠ¨ä¿®å¤ï¼šç³»ç»Ÿè‡ªåŠ¨çº æ­£ç®€å•é”™è¯¯
åŠè‡ªåŠ¨ä¿®å¤ï¼šç³»ç»Ÿæç¤ºï¼Œäººå·¥ç¡®è®¤
æ‰‹å·¥ä¿®å¤ï¼šå¤æ‚é—®é¢˜éœ€è¦äººå·¥åˆ†æå¤„ç†
```

### 4.2 å¸¸è§ä¸€è‡´æ€§é—®é¢˜åŠä¿®å¤


#### ğŸ”„ ä¸»é”®é‡å¤ä¿®å¤


```sql
-- å‘ç°é‡å¤ä¸»é”®
SELECT id, COUNT(*) as duplicate_count
FROM users 
GROUP BY id 
HAVING COUNT(*) > 1;

-- ä¿®å¤ç­–ç•¥1ï¼šä¿ç•™æœ€æ–°è®°å½•
DELETE u1 FROM users u1
INNER JOIN users u2 
WHERE u1.id = u2.id AND u1.created_time < u2.created_time;

-- ä¿®å¤ç­–ç•¥2ï¼šåˆå¹¶é‡å¤æ•°æ®
CREATE TABLE users_merged AS
SELECT id, 
       MAX(name) as name,
       MAX(email) as email,
       MAX(created_time) as created_time
FROM users 
GROUP BY id;
```

#### ğŸ”— å¤–é”®å¼•ç”¨ä¿®å¤


```sql
-- å‘ç°å­¤å„¿è®°å½•
SELECT o.* 
FROM orders o 
LEFT JOIN users u ON o.user_id = u.id 
WHERE u.id IS NULL;

-- ä¿®å¤ç­–ç•¥1ï¼šåˆ é™¤å­¤å„¿è®°å½•
DELETE o FROM orders o 
LEFT JOIN users u ON o.user_id = u.id 
WHERE u.id IS NULL;

-- ä¿®å¤ç­–ç•¥2ï¼šåˆ›å»ºç¼ºå¤±çš„çˆ¶è®°å½•
INSERT INTO users (id, name, email) 
SELECT DISTINCT user_id, CONCAT('User_', user_id), CONCAT('user', user_id, '@temp.com')
FROM orders o 
LEFT JOIN users u ON o.user_id = u.id 
WHERE u.id IS NULL;
```

### 4.3 ä¿®å¤è¿‡ç¨‹çš„å®‰å…¨ä¿éšœ


**å¤‡ä»½ä¼˜å…ˆåŸåˆ™**ï¼š
```sql
-- ä¿®å¤å‰åˆ›å»ºå¤‡ä»½
CREATE TABLE users_backup_20250906 AS SELECT * FROM users;
CREATE TABLE orders_backup_20250906 AS SELECT * FROM orders;

-- åœ¨äº‹åŠ¡ä¸­è¿›è¡Œä¿®å¤ï¼Œå¯ä»¥å›æ»š
START TRANSACTION;

-- æ‰§è¡Œä¿®å¤æ“ä½œ
DELETE FROM orders WHERE user_id NOT IN (SELECT id FROM users);

-- éªŒè¯ä¿®å¤ç»“æœ
SELECT COUNT(*) as orphan_orders 
FROM orders o 
LEFT JOIN users u ON o.user_id = u.id 
WHERE u.id IS NULL;

-- ç¡®è®¤æ— è¯¯åæäº¤ï¼Œå¦åˆ™å›æ»š
COMMIT;  -- æˆ– ROLLBACK;
```

---

## 5. ğŸ“Š ä¸€è‡´æ€§ç›‘æ§æŒ‡æ ‡


### 5.1 ç›‘æ§æŒ‡æ ‡ä½“ç³»


ä¸€è‡´æ€§ç›‘æ§å°±åƒç»™æ•°æ®åº“è£…ä¸Š"å¥åº·ç›‘æµ‹ä»ª"ï¼Œå®æ—¶äº†è§£æ•°æ®åº“çš„å¥åº·çŠ¶æ€ã€‚

**æ ¸å¿ƒç›‘æ§ç»´åº¦**ï¼š
```
çº¦æŸè¿åæ¬¡æ•°     â†’ åæ˜ æ•°æ®è´¨é‡é—®é¢˜é¢‘ç‡
ä¿®å¤æˆåŠŸç‡       â†’ åæ˜ è‡ªåŠ¨ä¿®å¤èƒ½åŠ›
æ•°æ®æ¼‚ç§»ç¨‹åº¦     â†’ åæ˜ æ•°æ®ä¸€è‡´æ€§ä¸‹é™è¶‹åŠ¿  
ä¸šåŠ¡è§„åˆ™ç¬¦åˆåº¦   â†’ åæ˜ ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§
```

### 5.2 å…³é”®ç›‘æ§æŒ‡æ ‡


#### ğŸ“ˆ çº¦æŸè¿åç›‘æ§


```sql
-- åˆ›å»ºçº¦æŸè¿åç›‘æ§è§†å›¾
CREATE VIEW constraint_violations AS
SELECT 
    'PRIMARY_KEY' as violation_type,
    'users' as table_name,
    COUNT(*) as violation_count
FROM (
    SELECT id FROM users GROUP BY id HAVING COUNT(*) > 1
) pk_violations

UNION ALL

SELECT 
    'FOREIGN_KEY' as violation_type,
    'orders' as table_name,
    COUNT(*) as violation_count
FROM orders o 
LEFT JOIN users u ON o.user_id = u.id 
WHERE u.id IS NULL;

-- å®šæœŸæ£€æŸ¥è¿åæƒ…å†µ
SELECT violation_type, table_name, violation_count,
       CASE 
           WHEN violation_count = 0 THEN 'æ­£å¸¸'
           WHEN violation_count < 10 THEN 'è½»å¾®'
           WHEN violation_count < 100 THEN 'ä¸­ç­‰'
           ELSE 'ä¸¥é‡'
       END as severity_level
FROM constraint_violations;
```

#### ğŸ“Š æ•°æ®è´¨é‡å¾—åˆ†


```sql
-- æ•°æ®è´¨é‡è¯„åˆ†å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE CalculateDataQualityScore()
BEGIN
    DECLARE total_records INT DEFAULT 0;
    DECLARE valid_records INT DEFAULT 0;
    DECLARE quality_score DECIMAL(5,2) DEFAULT 0.00;
    
    -- ç»Ÿè®¡æ€»è®°å½•æ•°
    SELECT COUNT(*) INTO total_records FROM users;
    
    -- ç»Ÿè®¡æœ‰æ•ˆè®°å½•æ•°ï¼ˆç¬¦åˆæ‰€æœ‰çº¦æŸï¼‰
    SELECT COUNT(*) INTO valid_records 
    FROM users 
    WHERE id IS NOT NULL 
      AND name IS NOT NULL 
      AND email IS NOT NULL 
      AND email REGEXP '^[A-Za-z0-9._%-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$'
      AND age BETWEEN 0 AND 150;
    
    -- è®¡ç®—è´¨é‡å¾—åˆ†
    IF total_records > 0 THEN
        SET quality_score = (valid_records / total_records) * 100;
    END IF;
    
    -- è®°å½•ç›‘æ§ç»“æœ
    INSERT INTO data_quality_log (table_name, total_records, valid_records, quality_score, check_time)
    VALUES ('users', total_records, valid_records, quality_score, NOW());
    
    SELECT quality_score as 'æ•°æ®è´¨é‡å¾—åˆ†(%)';
END//
DELIMITER ;
```

### 5.3 å®æ—¶ç›‘æ§å‘Šè­¦


**å‘Šè­¦è§„åˆ™è®¾ç½®**ï¼š
```sql
-- åˆ›å»ºå‘Šè­¦é…ç½®è¡¨
CREATE TABLE alert_rules (
    id INT AUTO_INCREMENT PRIMARY KEY,
    metric_name VARCHAR(100),
    threshold_value DECIMAL(10,2),
    operator ENUM('>', '<', '=', '>=', '<='),
    alert_level ENUM('INFO', 'WARNING', 'ERROR', 'CRITICAL'),
    is_active BOOLEAN DEFAULT TRUE
);

-- æ’å…¥å‘Šè­¦è§„åˆ™
INSERT INTO alert_rules VALUES 
(1, 'constraint_violations', 0, '>', 'WARNING', TRUE),
(2, 'data_quality_score', 95.0, '<', 'ERROR', TRUE),
(3, 'orphan_records', 10, '>', 'CRITICAL', TRUE);

-- å‘Šè­¦æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE CheckAlerts()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE rule_id INT;
    DECLARE metric VARCHAR(100);
    DECLARE threshold_val DECIMAL(10,2);
    DECLARE op VARCHAR(5);
    DECLARE level VARCHAR(20);
    
    DECLARE cur CURSOR FOR 
        SELECT id, metric_name, threshold_value, operator, alert_level 
        FROM alert_rules WHERE is_active = TRUE;
    
    OPEN cur;
    
    read_loop: LOOP
        FETCH cur INTO rule_id, metric, threshold_val, op, level;
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- æ ¹æ®ä¸åŒæŒ‡æ ‡è¿›è¡Œæ£€æŸ¥å’Œå‘Šè­¦
        -- è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„æ£€æŸ¥é€»è¾‘
        
    END LOOP;
    
    CLOSE cur;
END//
DELIMITER ;
```

---

## 6. ğŸš¨ ä¸€è‡´æ€§æ•…éšœå¤„ç†


### 6.1 æ•…éšœç±»å‹åˆ†æ


æ•°æ®ä¸€è‡´æ€§æ•…éšœå°±åƒå„ç§"ç–¾ç—…"ï¼Œéœ€è¦å‡†ç¡®è¯Šæ–­æ‰èƒ½å¯¹ç—‡ä¸‹è¯ã€‚

**å¸¸è§æ•…éšœåˆ†ç±»**ï¼š
```
ç¡¬ä»¶æ•…éšœ    â†’ ç£ç›˜æŸåã€å†…å­˜é”™è¯¯å¯¼è‡´æ•°æ®æŸå
è½¯ä»¶æ•…éšœ    â†’ ç¨‹åºbugã€SQLé”™è¯¯å¯¼è‡´æ•°æ®ä¸ä¸€è‡´  
æ“ä½œæ•…éšœ    â†’ äººä¸ºè¯¯æ“ä½œã€å¹¶å‘å†²çª
ç½‘ç»œæ•…éšœ    â†’ ä¸»ä»åŒæ­¥ä¸­æ–­ã€åˆ†å¸ƒå¼äº‹åŠ¡å¤±è´¥
```

### 6.2 æ•…éšœæ£€æµ‹æœºåˆ¶


#### ğŸ” è‡ªåŠ¨æ£€æµ‹


```sql
-- åˆ›å»ºä¸€è‡´æ€§æ£€æŸ¥ä»»åŠ¡
CREATE EVENT daily_consistency_check
ON SCHEDULE EVERY 1 DAY
STARTS '2025-09-06 02:00:00'
DO
BEGIN
    -- æ£€æŸ¥å„ç§ä¸€è‡´æ€§é—®é¢˜
    CALL CheckConstraintViolations();
    CALL CheckDataQuality();
    CALL CheckReferentialIntegrity();
    
    -- è®°å½•æ£€æŸ¥ç»“æœ
    INSERT INTO consistency_check_log (check_date, status, details)
    VALUES (CURDATE(), 'COMPLETED', 'Daily consistency check finished');
END;

-- å®æ—¶æ£€æµ‹è§¦å‘å™¨
DELIMITER //
CREATE TRIGGER detect_anomaly
AFTER INSERT ON orders
FOR EACH ROW
BEGIN
    -- æ£€æµ‹å¼‚å¸¸å¤§é¢è®¢å•
    IF NEW.amount > 100000 THEN
        INSERT INTO anomaly_log (table_name, record_id, anomaly_type, detected_time)
        VALUES ('orders', NEW.id, 'HIGH_AMOUNT', NOW());
    END IF;
    
    -- æ£€æµ‹æ—¶é—´å¼‚å¸¸
    IF NEW.order_date > NOW() + INTERVAL 1 DAY THEN
        INSERT INTO anomaly_log (table_name, record_id, anomaly_type, detected_time)
        VALUES ('orders', NEW.id, 'FUTURE_DATE', NOW());
    END IF;
END//
DELIMITER ;
```

### 6.3 æ•…éšœå¤„ç†æµç¨‹


**æ ‡å‡†å¤„ç†æµç¨‹**ï¼š
```
1. æ•…éšœæ£€æµ‹ â†’ å‘ç°é—®é¢˜
2. å½±å“è¯„ä¼° â†’ åˆ†æä¸¥é‡ç¨‹åº¦  
3. åº”æ€¥å¤„ç† â†’ é˜²æ­¢é—®é¢˜æ‰©æ•£
4. æ ¹å› åˆ†æ â†’ æ‰¾å‡ºé—®é¢˜åŸå› 
5. å½»åº•ä¿®å¤ â†’ è§£å†³æ ¹æœ¬é—®é¢˜
6. é¢„é˜²æªæ–½ â†’ é¿å…å†æ¬¡å‘ç”Ÿ
```

#### ğŸš‘ åº”æ€¥å¤„ç†ç¤ºä¾‹


```sql
-- å‘ç°æ•°æ®ä¸ä¸€è‡´çš„åº”æ€¥å¤„ç†
DELIMITER //
CREATE PROCEDURE EmergencyInconsistencyHandle(
    IN table_name VARCHAR(100),
    IN issue_type VARCHAR(100)
)
BEGIN
    DECLARE emergency_mode BOOLEAN DEFAULT FALSE;
    
    -- 1. ç«‹å³åˆ›å»ºå¤‡ä»½
    SET @backup_sql = CONCAT('CREATE TABLE ', table_name, '_emergency_backup_', 
                           DATE_FORMAT(NOW(), '%Y%m%d_%H%i%s'), 
                           ' AS SELECT * FROM ', table_name);
    PREPARE stmt FROM @backup_sql;
    EXECUTE stmt;
    
    -- 2. è®°å½•æ•…éšœä¿¡æ¯
    INSERT INTO incident_log (table_name, issue_type, severity, start_time, status)
    VALUES (table_name, issue_type, 'HIGH', NOW(), 'HANDLING');
    
    -- 3. æ ¹æ®é—®é¢˜ç±»å‹é‡‡å–æªæ–½
    CASE issue_type
        WHEN 'CONSTRAINT_VIOLATION' THEN
            -- æš‚æ—¶ç¦ç”¨çº¦æŸæ£€æŸ¥ï¼Œé˜²æ­¢ä¸šåŠ¡ä¸­æ–­
            SET foreign_key_checks = 0;
            SET unique_checks = 0;
            
        WHEN 'DATA_CORRUPTION' THEN
            -- åˆ‡æ¢åˆ°åªè¯»æ¨¡å¼
            SET emergency_mode = TRUE;
            
        ELSE
            -- è®°å½•æœªçŸ¥é—®é¢˜ç±»å‹
            INSERT INTO error_log VALUES (NOW(), 'UNKNOWN_ISSUE_TYPE', issue_type);
    END CASE;
    
    -- 4. é€šçŸ¥ç›¸å…³äººå‘˜
    INSERT INTO alert_queue (alert_type, message, priority, create_time)
    VALUES ('EMERGENCY', CONCAT('æ•°æ®ä¸€è‡´æ€§æ•…éšœ: ', table_name, ' - ', issue_type), 'HIGH', NOW());
    
END//
DELIMITER ;
```

---

## 7. ğŸ›¡ï¸ ä¸€è‡´æ€§ä¿è¯å®Œæ•´æœºåˆ¶


### 7.1 å®Œæ•´ä¿è¯ä½“ç³»


ä¸€è‡´æ€§ä¿è¯æœºåˆ¶å°±åƒä¸€å¥—å®Œæ•´çš„"é˜²æŠ¤ç³»ç»Ÿ"ï¼Œä»é¢„é˜²ã€æ£€æµ‹åˆ°ä¿®å¤å½¢æˆé—­ç¯ã€‚

**ä¿è¯ä½“ç³»æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é¢„é˜²æœºåˆ¶       â”‚ â† çº¦æŸè®¾è®¡ã€æ•°æ®éªŒè¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ£€æµ‹æœºåˆ¶       â”‚ â† å®æ—¶ç›‘æ§ã€å®šæœŸæ£€æŸ¥  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¿®å¤æœºåˆ¶       â”‚ â† è‡ªåŠ¨ä¿®å¤ã€äººå·¥å¹²é¢„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ¢å¤æœºåˆ¶       â”‚ â† å¤‡ä»½æ¢å¤ã€å›æ»šæ“ä½œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é¢„é˜²æ€§ä¿è¯ç­–ç•¥


#### ğŸ“‹ çº¦æŸè®¾è®¡æœ€ä½³å®è·µ


```sql
-- å®Œå–„çš„çº¦æŸè®¾è®¡ç¤ºä¾‹
CREATE TABLE comprehensive_user (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE 
        CHECK (email REGEXP '^[A-Za-z0-9._%-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$'),
    age INT CHECK (age >= 0 AND age <= 150),
    status ENUM('ACTIVE', 'INACTIVE', 'SUSPENDED') DEFAULT 'ACTIVE',
    balance DECIMAL(15,2) DEFAULT 0.00 CHECK (balance >= 0),
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- å¤åˆçº¦æŸ
    CONSTRAINT chk_username_length CHECK (CHAR_LENGTH(username) >= 3),
    CONSTRAINT chk_future_date CHECK (created_time <= NOW())
);

-- å…³è”è¡¨çš„å®Œæ•´çº¦æŸ
CREATE TABLE user_orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    order_amount DECIMAL(10,2) NOT NULL CHECK (order_amount > 0),
    order_date DATE NOT NULL,
    status ENUM('PENDING', 'PAID', 'SHIPPED', 'COMPLETED', 'CANCELLED') DEFAULT 'PENDING',
    
    FOREIGN KEY (user_id) REFERENCES comprehensive_user(id) 
        ON DELETE RESTRICT ON UPDATE CASCADE,
    
    -- ä¸šåŠ¡çº¦æŸï¼šè®¢å•æ—¥æœŸä¸èƒ½æ˜¯æœªæ¥
    CONSTRAINT chk_order_date CHECK (order_date <= CURDATE()),
    
    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_user_date (user_id, order_date),
    INDEX idx_status_date (status, order_date)
);
```

### 7.3 è¿è¡Œæ—¶ä¿è¯æœºåˆ¶


#### âš™ï¸ äº‹åŠ¡çº§åˆ«ä¸€è‡´æ€§ä¿è¯


```sql
-- å¤æ‚ä¸šåŠ¡äº‹åŠ¡çš„ä¸€è‡´æ€§ä¿è¯
DELIMITER //
CREATE PROCEDURE TransferMoney(
    IN from_user_id INT,
    IN to_user_id INT, 
    IN amount DECIMAL(10,2)
)
BEGIN
    DECLARE from_balance DECIMAL(15,2);
    DECLARE to_balance DECIMAL(15,2);
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;
    
    START TRANSACTION;
    
    -- 1. åŠ é”é˜²æ­¢å¹¶å‘é—®é¢˜
    SELECT balance INTO from_balance 
    FROM comprehensive_user 
    WHERE id = from_user_id FOR UPDATE;
    
    SELECT balance INTO to_balance 
    FROM comprehensive_user 
    WHERE id = to_user_id FOR UPDATE;
    
    -- 2. ä¸šåŠ¡è§„åˆ™éªŒè¯
    IF from_balance < amount THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'ä½™é¢ä¸è¶³';
    END IF;
    
    IF amount <= 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'è½¬è´¦é‡‘é¢å¿…é¡»å¤§äº0';
    END IF;
    
    -- 3. æ‰§è¡Œè½¬è´¦æ“ä½œ
    UPDATE comprehensive_user 
    SET balance = balance - amount 
    WHERE id = from_user_id;
    
    UPDATE comprehensive_user 
    SET balance = balance + amount 
    WHERE id = to_user_id;
    
    -- 4. è®°å½•è½¬è´¦è®°å½•
    INSERT INTO transfer_log (from_user_id, to_user_id, amount, transfer_time)
    VALUES (from_user_id, to_user_id, amount, NOW());
    
    -- 5. éªŒè¯æœ€ç»ˆçŠ¶æ€
    SELECT balance INTO from_balance FROM comprehensive_user WHERE id = from_user_id;
    SELECT balance INTO to_balance FROM comprehensive_user WHERE id = to_user_id;
    
    IF from_balance < 0 OR to_balance < 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'è½¬è´¦åä½™é¢å¼‚å¸¸';
    END IF;
    
    COMMIT;
END//
DELIMITER ;
```

### 7.4 ç³»ç»Ÿçº§ä¿è¯ç­–ç•¥


**é…ç½®ä¼˜åŒ–**ï¼š
```sql
-- MySQLé…ç½®ä¼˜åŒ–ï¼ˆmy.cnfä¸­çš„è®¾ç½®ï¼‰
/*
[mysqld]
# äº‹åŠ¡éš”ç¦»çº§åˆ«
transaction-isolation = READ-COMMITTED

# InnoDBé…ç½®
innodb_flush_log_at_trx_commit = 1  # æ¯æ¬¡äº‹åŠ¡æäº¤éƒ½åˆ·æ–°æ—¥å¿—
innodb_doublewrite = ON             # åŒå†™ç¼“å†²é˜²æ­¢æ•°æ®æŸå
innodb_file_per_table = ON          # ç‹¬ç«‹è¡¨ç©ºé—´
innodb_lock_wait_timeout = 50       # é”ç­‰å¾…è¶…æ—¶

# æ—¥å¿—é…ç½®
log-bin = mysql-bin                 # å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—
sync_binlog = 1                     # åŒæ­¥å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—
expire_logs_days = 7                # æ—¥å¿—ä¿ç•™å¤©æ•°

# å®‰å…¨é…ç½®
sql_mode = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
*/

-- è¿è¡Œæ—¶ç›‘æ§æŸ¥è¯¢
SELECT 
    VARIABLE_NAME as 'é…ç½®é¡¹',
    VARIABLE_VALUE as 'å½“å‰å€¼'
FROM INFORMATION_SCHEMA.GLOBAL_VARIABLES 
WHERE VARIABLE_NAME IN (
    'transaction_isolation',
    'innodb_flush_log_at_trx_commit',
    'innodb_doublewrite',
    'sql_mode'
);
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡ä¸€è‡´æ€§ï¼šç¡®ä¿æ•°æ®åº“åœ¨äº‹åŠ¡å‰åéƒ½ä¿æŒæ­£ç¡®çŠ¶æ€
ğŸ”¸ ä¸€è‡´æ€§æ£€æŸ¥ï¼šå®šæœŸæˆ–å®æ—¶éªŒè¯æ•°æ®æ˜¯å¦ç¬¦åˆçº¦æŸå’Œä¸šåŠ¡è§„åˆ™  
ğŸ”¸ çº¦æŸéªŒè¯ï¼šé€šè¿‡å„ç§çº¦æŸç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§
ğŸ”¸ ä¿®å¤ç­–ç•¥ï¼šå‘ç°ä¸ä¸€è‡´æ—¶çš„çº æ­£æ–¹æ³•å’Œæµç¨‹
ğŸ”¸ ç›‘æ§æŒ‡æ ‡ï¼šå®æ—¶äº†è§£æ•°æ®åº“ä¸€è‡´æ€§å¥åº·çŠ¶æ€çš„åº¦é‡æ ‡å‡†
ğŸ”¸ æ•…éšœå¤„ç†ï¼šåº”å¯¹ä¸€è‡´æ€§é—®é¢˜çš„åº”æ€¥å’Œä¿®å¤æµç¨‹
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸€è‡´æ€§çš„æœ¬è´¨**
- ä¸ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´æ˜¯ä¸šåŠ¡æ­£ç¡®æ€§é—®é¢˜
- éœ€è¦åœ¨æ€§èƒ½å’Œä¸€è‡´æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡
- é¢„é˜²æ¯”ä¿®å¤æ›´é‡è¦ï¼Œè®¾è®¡é˜¶æ®µå°±è¦è€ƒè™‘å…¨é¢

**ğŸ”¹ æ£€æŸ¥ç®—æ³•çš„æ ¸å¿ƒ**  
- çº¦æŸæ£€æŸ¥æ˜¯åŸºç¡€ï¼Œä¸šåŠ¡è§„åˆ™æ£€æŸ¥æ˜¯å…³é”®
- å¢é‡æ£€æŸ¥æ¯”å…¨é‡æ£€æŸ¥æ›´é«˜æ•ˆ
- å®æ—¶æ£€æŸ¥å’Œå®šæœŸæ£€æŸ¥éœ€è¦ç»“åˆä½¿ç”¨

**ğŸ”¹ ä¿®å¤ç­–ç•¥çš„é€‰æ‹©**
- è‡ªåŠ¨ä¿®å¤é€‚ç”¨äºç®€å•æ˜ç¡®çš„é—®é¢˜
- å¤æ‚é—®é¢˜éœ€è¦äººå·¥åˆ†æå’Œå¤„ç†
- ä¿®å¤å‰ä¸€å®šè¦å¤‡ä»½ï¼Œä¿®å¤åä¸€å®šè¦éªŒè¯

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- **ç”µå•†ç³»ç»Ÿ**ï¼šåº“å­˜ä¸€è‡´æ€§ã€è®¢å•çŠ¶æ€ä¸€è‡´æ€§ã€ç”¨æˆ·ä½™é¢ä¸€è‡´æ€§
- **é‡‘èç³»ç»Ÿ**ï¼šè´¦æˆ·ä½™é¢ä¸€è‡´æ€§ã€äº¤æ˜“è®°å½•å®Œæ•´æ€§ã€é£æ§è§„åˆ™ä¸€è‡´æ€§  
- **ç¤¾äº¤ç³»ç»Ÿ**ï¼šç”¨æˆ·å…³ç³»ä¸€è‡´æ€§ã€å†…å®¹çŠ¶æ€ä¸€è‡´æ€§ã€æƒé™è®¾ç½®ä¸€è‡´æ€§

**è¿ç»´å®è·µè¦ç‚¹**ï¼š
- **ç›‘æ§ä½“ç³»**ï¼šå»ºç«‹å®Œå–„çš„ä¸€è‡´æ€§ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- **åº”æ€¥é¢„æ¡ˆ**ï¼šåˆ¶å®šè¯¦ç»†çš„æ•…éšœå¤„ç†æµç¨‹å’Œæ¢å¤æ–¹æ¡ˆ
- **å®šæœŸæ£€æŸ¥**ï¼šå»ºç«‹å®šæœŸçš„æ•°æ®ä¸€è‡´æ€§å·¡æ£€åˆ¶åº¦
- **åŸ¹è®­æ•™è‚²**ï¼šæé«˜å¼€å‘å’Œè¿ç»´äººå‘˜çš„ä¸€è‡´æ€§æ„è¯†

> ğŸ’¡ **æ ¸å¿ƒè®°å¿†**ï¼š
> ä¸€è‡´æ€§ä¿è¯å¦‚åŒ»ç–—ä½“ç³»ï¼šé¢„é˜²æ˜¯ä½“æ£€ï¼Œæ£€æµ‹æ˜¯è¯Šæ–­ï¼Œä¿®å¤æ˜¯æ²»ç–—ï¼Œç›‘æ§æ˜¯ä¿å¥ã€‚
> åªæœ‰å»ºç«‹å®Œæ•´çš„"åŒ»ç–—ä½“ç³»"ï¼Œæ‰èƒ½ç¡®ä¿æ•°æ®åº“çš„é•¿æœŸå¥åº·è¿è¡Œã€‚

> âš ï¸ **é‡è¦æé†’**ï¼š
> ä¸€è‡´æ€§ä¸æ˜¯å…è´¹çš„ï¼Œéœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€è®¡ç®—èµ„æºå’Œç»´æŠ¤æˆæœ¬ã€‚
> åœ¨è®¾è®¡æ—¶è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆç†æƒè¡¡ä¸€è‡´æ€§å¼ºåº¦å’Œç³»ç»Ÿæ€§èƒ½ã€‚