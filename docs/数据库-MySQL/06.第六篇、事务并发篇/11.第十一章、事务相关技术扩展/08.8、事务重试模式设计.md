---
title: 8ã€äº‹åŠ¡é‡è¯•æ¨¡å¼è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [äº‹åŠ¡é‡è¯•åŸºæœ¬æ¦‚å¿µ](#1-äº‹åŠ¡é‡è¯•åŸºæœ¬æ¦‚å¿µ)
2. [æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥](#2-æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥)
3. [é‡è¯•æ¡ä»¶åˆ¤æ–­æœºåˆ¶](#3-é‡è¯•æ¡ä»¶åˆ¤æ–­æœºåˆ¶)
4. [é‡è¯•çŠ¶æ€ä¿æŒä¸ç®¡ç†](#4-é‡è¯•çŠ¶æ€ä¿æŒä¸ç®¡ç†)
5. [é‡è¯•ç›‘æ§ä¸ç»Ÿè®¡](#5-é‡è¯•ç›‘æ§ä¸ç»Ÿè®¡)
6. [å®Œæ•´å®è·µæ¡ˆä¾‹](#6-å®Œæ•´å®è·µæ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ äº‹åŠ¡é‡è¯•åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡é‡è¯•


**äº‹åŠ¡é‡è¯•**å°±åƒé‡åˆ°ç½‘ç»œä¸å¥½æ—¶é‡æ–°æ‹¨æ‰“ç”µè¯ä¸€æ ·ï¼Œå½“æ•°æ®åº“äº‹åŠ¡å› ä¸ºä¸´æ—¶æ€§é—®é¢˜ï¼ˆå¦‚é”å†²çªã€ç½‘ç»œæŠ–åŠ¨ï¼‰å¤±è´¥æ—¶ï¼Œç¨‹åºè‡ªåŠ¨é‡æ–°å°è¯•æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ã€‚

```
ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡é‡è¯•ï¼Ÿ

æ—¥å¸¸åœºæ™¯ç±»æ¯”ï¼š
ç½‘ä¸Šè´­ç‰©ä»˜æ¬¾ â†’ ç½‘ç»œå¡é¡¿å¤±è´¥ â†’ è‡ªåŠ¨é‡è¯• â†’ æ”¯ä»˜æˆåŠŸ

æ•°æ®åº“åœºæ™¯ï¼š
è½¬è´¦äº‹åŠ¡ â†’ æ­»é”å¤±è´¥ â†’ è‡ªåŠ¨é‡è¯• â†’ è½¬è´¦æˆåŠŸ
```

### 1.2 é‡è¯•çš„æ ¸å¿ƒä»·å€¼


**ğŸ¯ è§£å†³çš„é—®é¢˜**ï¼š
- **ä¸´æ—¶æ€§æ•…éšœ**ï¼šç½‘ç»œæŠ–åŠ¨ã€è¿æ¥è¶…æ—¶
- **å¹¶å‘å†²çª**ï¼šæ­»é”ã€é”ç­‰å¾…è¶…æ—¶
- **èµ„æºç«äº‰**ï¼šCPU/å†…å­˜ç¬æ—¶ä¸è¶³
- **ç³»ç»Ÿè´Ÿè½½**ï¼šæ•°æ®åº“ç¹å¿™æœŸé—´çš„æ‹’ç»æœåŠ¡

**ğŸ’¡ ä¸šåŠ¡ä»·å€¼**ï¼š
```
æå‡æˆåŠŸç‡ï¼š95% â†’ 99.5%
å‡å°‘ç”¨æˆ·æ„ŸçŸ¥ï¼šæ— éœ€æ‰‹åŠ¨é‡è¯•
ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼šé¿å…éƒ¨åˆ†æˆåŠŸçš„è„æ•°æ®
```

### 1.3 é‡è¯•é€‚ç”¨åœºæ™¯åˆ¤æ–­


**âœ… é€‚åˆé‡è¯•çš„æƒ…å†µ**ï¼š
```markdown
ğŸ”¸ **ä¸´æ—¶æ€§é”™è¯¯**
- è¿æ¥è¶…æ—¶ (Connection timeout)
- é”ç­‰å¾…è¶…æ—¶ (Lock wait timeout)
- æ­»é”æ£€æµ‹ (Deadlock found)

ğŸ”¸ **èµ„æºç«äº‰**
- Too many connections
- Table is locked
- Temporary disk full

ğŸ”¸ **ç½‘ç»œé—®é¢˜**
- Network unreachable
- Connection reset
```

**âŒ ä¸é€‚åˆé‡è¯•çš„æƒ…å†µ**ï¼š
```markdown
ğŸ”¸ **ä¸šåŠ¡é€»è¾‘é”™è¯¯**
- ä½™é¢ä¸è¶³
- æ•°æ®æ ¼å¼é”™è¯¯
- è¿åä¸šåŠ¡è§„åˆ™

ğŸ”¸ **æƒé™é—®é¢˜**
- ç”¨æˆ·æ— æƒé™
- è¡¨ä¸å­˜åœ¨
- è¯­æ³•é”™è¯¯
```

---

## 2. ğŸ“ˆ æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥


### 2.1 ä»€ä¹ˆæ˜¯æŒ‡æ•°é€€é¿


**æŒ‡æ•°é€€é¿**å°±åƒæ’é˜Ÿä¹°å¥¶èŒ¶ï¼Œç¬¬ä¸€æ¬¡æ’é˜Ÿ5åˆ†é’Ÿï¼Œå¦‚æœè¿˜æ˜¯å¾ˆæŒ¤å°±ç­‰10åˆ†é’Ÿå†å»ï¼Œå†æŒ¤å°±ç­‰20åˆ†é’Ÿï¼Œæ¯æ¬¡ç­‰å¾…æ—¶é—´ç¿»å€ï¼Œé¿å…å¤§å®¶éƒ½åŒæ—¶å»æŠ¢ã€‚

```
é€€é¿æ—¶é—´è®¡ç®—ï¼š
ç¬¬1æ¬¡é‡è¯•ï¼šç­‰å¾… 1 ç§’
ç¬¬2æ¬¡é‡è¯•ï¼šç­‰å¾… 2 ç§’  
ç¬¬3æ¬¡é‡è¯•ï¼šç­‰å¾… 4 ç§’
ç¬¬4æ¬¡é‡è¯•ï¼šç­‰å¾… 8 ç§’
```

### 2.2 æŒ‡æ•°é€€é¿å®ç°


**ğŸ”§ åŸºç¡€å®ç°**ï¼š
```java
public class ExponentialBackoff {
    private final int maxRetries;
    private final long baseDelayMs;
    private final long maxDelayMs;
    
    public ExponentialBackoff(int maxRetries, long baseDelayMs, long maxDelayMs) {
        this.maxRetries = maxRetries;
        this.baseDelayMs = baseDelayMs;
        this.maxDelayMs = maxDelayMs;
    }
    
    // è®¡ç®—ç­‰å¾…æ—¶é—´
    public long calculateDelay(int attemptNumber) {
        long delay = baseDelayMs * (1L << attemptNumber); // 2^attemptNumber
        return Math.min(delay, maxDelayMs); // ä¸è¶…è¿‡æœ€å¤§å»¶è¿Ÿ
    }
}
```

### 2.3 åŠ å…¥éšæœºæŠ–åŠ¨


ä¸ºäº†é¿å…"æƒŠç¾¤æ•ˆåº”"ï¼ˆæ‰€æœ‰çº¿ç¨‹åŒæ—¶é‡è¯•ï¼‰ï¼Œåœ¨ç­‰å¾…æ—¶é—´åŸºç¡€ä¸ŠåŠ å…¥éšæœºæŠ–åŠ¨ï¼š

```java
public long calculateDelayWithJitter(int attemptNumber) {
    long baseDelay = calculateDelay(attemptNumber);
    // åŠ å…¥ Â±20% çš„éšæœºæŠ–åŠ¨
    long jitter = (long) (baseDelay * 0.2 * Math.random());
    return baseDelay + jitter - (long)(baseDelay * 0.1);
}
```

**æŠ–åŠ¨æ•ˆæœå¯¹æ¯”**ï¼š
```
æ— æŠ–åŠ¨ï¼š1000ms, 2000ms, 4000ms, 8000ms
æœ‰æŠ–åŠ¨ï¼š900ms, 1800ms, 4200ms, 7600ms
```

### 2.4 é€€é¿ç­–ç•¥é…ç½®


**ğŸ“Š å¸¸ç”¨é…ç½®å‚æ•°**ï¼š

| å‚æ•° | è¯´æ˜ | æ¨èå€¼ | ä½œç”¨ |
|------|------|--------|------|
| `åŸºç¡€å»¶è¿Ÿ` | ç¬¬ä¸€æ¬¡é‡è¯•ç­‰å¾…æ—¶é—´ | `100-500ms` | å¹³è¡¡å“åº”é€Ÿåº¦ä¸æˆåŠŸç‡ |
| `æœ€å¤§é‡è¯•æ¬¡æ•°` | æœ€å¤šé‡è¯•å‡ æ¬¡ | `3-5æ¬¡` | é¿å…æ— é™é‡è¯• |
| `æœ€å¤§å»¶è¿Ÿ` | å•æ¬¡ç­‰å¾…ä¸Šé™ | `30-60ç§’` | é˜²æ­¢ç­‰å¾…è¿‡ä¹… |
| `æŠ–åŠ¨èŒƒå›´` | éšæœºæŠ–åŠ¨æ¯”ä¾‹ | `10-30%` | é¿å…æƒŠç¾¤æ•ˆåº” |

---

## 3. ğŸ¯ é‡è¯•æ¡ä»¶åˆ¤æ–­æœºåˆ¶


### 3.1 é”™è¯¯åˆ†ç±»è¯†åˆ«


é‡è¯•å‰éœ€è¦åˆ¤æ–­é”™è¯¯ç±»å‹ï¼Œå°±åƒåŒ»ç”Ÿçœ‹ç—…è¦å…ˆè¯Šæ–­ç—…æƒ…å†å†³å®šæ²»ç–—æ–¹æ¡ˆï¼š

```java
public class RetryConditionChecker {
    
    // å¯é‡è¯•çš„é”™è¯¯ç 
    private static final Set<Integer> RETRYABLE_ERROR_CODES = Set.of(
        1205, // Lock wait timeout
        1213, // Deadlock found  
        1040, // Too many connections
        2006, // MySQL server has gone away
        2013  // Lost connection to MySQL server
    );
    
    public boolean shouldRetry(SQLException e) {
        // 1. æ£€æŸ¥é”™è¯¯ç 
        if (RETRYABLE_ERROR_CODES.contains(e.getErrorCode())) {
            return true;
        }
        
        // 2. æ£€æŸ¥é”™è¯¯æ¶ˆæ¯
        String message = e.getMessage().toLowerCase();
        if (message.contains("timeout") || 
            message.contains("connection") ||
            message.contains("deadlock")) {
            return true;
        }
        
        return false;
    }
}
```

### 3.2 ä¸šåŠ¡å±‚é¢åˆ¤æ–­


é™¤äº†æŠ€æœ¯é”™è¯¯ï¼Œè¿˜è¦è€ƒè™‘ä¸šåŠ¡å±‚é¢çš„é‡è¯•æ¡ä»¶ï¼š

```java
public class BusinessRetryChecker {
    
    public boolean canBusinessRetry(String operation, Object... params) {
        switch (operation) {
            case "transfer":
                // è½¬è´¦æ“ä½œï¼šæ£€æŸ¥è´¦æˆ·çŠ¶æ€æ˜¯å¦è¿˜æœ‰æ•ˆ
                return checkAccountStatus(params[0], params[1]);
                
            case "order":
                // ä¸‹å•æ“ä½œï¼šæ£€æŸ¥åº“å­˜æ˜¯å¦è¿˜å¤Ÿ
                return checkInventory(params[0]);
                
            default:
                return true;
        }
    }
}
```

### 3.3 åŠ¨æ€é‡è¯•æ¡ä»¶


æ ¹æ®ç³»ç»Ÿå½“å‰çŠ¶æ€åŠ¨æ€è°ƒæ•´é‡è¯•ç­–ç•¥ï¼š

```
ç³»ç»Ÿè´Ÿè½½ç›‘æ§ï¼š
CPUä½¿ç”¨ç‡ > 80% â†’ å¢åŠ é‡è¯•é—´éš”
è¿æ¥æ± å ç”¨ > 90% â†’ å‡å°‘é‡è¯•æ¬¡æ•°
é”™è¯¯ç‡ > 10% â†’ æš‚åœé‡è¯•

è´Ÿè½½è‡ªé€‚åº”ï¼š
ä½è´Ÿè½½æœŸï¼šå¿«é€Ÿé‡è¯•ï¼Œæé«˜å“åº”é€Ÿåº¦
é«˜è´Ÿè½½æœŸï¼šæ…¢é€Ÿé‡è¯•ï¼Œå‡è½»ç³»ç»Ÿå‹åŠ›
```

---

## 4. ğŸ’¾ é‡è¯•çŠ¶æ€ä¿æŒä¸ç®¡ç†


### 4.1 é‡è¯•çŠ¶æ€è®¾è®¡


é‡è¯•è¿‡ç¨‹éœ€è¦è·Ÿè¸ªçŠ¶æ€ï¼Œå°±åƒå¿«é€’è¿½è¸ªä¸€æ ·è®°å½•æ¯æ¬¡æŠ•é€’æƒ…å†µï¼š

```java
public class RetryState {
    private final String operationId;      // æ“ä½œå”¯ä¸€æ ‡è¯†
    private int currentAttempt;           // å½“å‰é‡è¯•æ¬¡æ•°
    private long lastAttemptTime;         // ä¸Šæ¬¡é‡è¯•æ—¶é—´
    private String lastError;             // æœ€åä¸€æ¬¡é”™è¯¯ä¿¡æ¯
    private Map<String, Object> context;  // é‡è¯•ä¸Šä¸‹æ–‡
    
    // é‡è¯•å†å²è®°å½•
    private List<RetryAttempt> attempts = new ArrayList<>();
    
    public static class RetryAttempt {
        private final int attemptNumber;
        private final long timestamp;
        private final String errorMessage;
        private final long duration;
    }
}
```

### 4.2 çŠ¶æ€æŒä¹…åŒ–


å¯¹äºé‡è¦æ“ä½œï¼Œéœ€è¦å°†é‡è¯•çŠ¶æ€æŒä¹…åŒ–ï¼Œé˜²æ­¢ç¨‹åºé‡å¯åä¸¢å¤±ï¼š

```java
@Repository
public class RetryStateRepository {
    
    // ä¿å­˜é‡è¯•çŠ¶æ€åˆ°æ•°æ®åº“
    public void saveRetryState(RetryState state) {
        String sql = """
            INSERT INTO retry_states (operation_id, attempt_count, 
                       last_attempt_time, context_data, created_at)
            VALUES (?, ?, ?, ?, ?)
            ON DUPLICATE KEY UPDATE
                attempt_count = VALUES(attempt_count),
                last_attempt_time = VALUES(last_attempt_time)
            """;
        // æ‰§è¡Œä¿å­˜...
    }
    
    // æŸ¥è¯¢é‡è¯•çŠ¶æ€
    public RetryState findByOperationId(String operationId) {
        // ä»æ•°æ®åº“æŸ¥è¯¢...
    }
}
```

### 4.3 çŠ¶æ€æ¸…ç†æœºåˆ¶


**ğŸ§¹ å®šæ—¶æ¸…ç†ç­–ç•¥**ï¼š
```sql
-- æ¸…ç†è¶…è¿‡7å¤©çš„æˆåŠŸé‡è¯•è®°å½•
DELETE FROM retry_states 
WHERE status = 'SUCCESS' 
  AND created_at < DATE_SUB(NOW(), INTERVAL 7 DAY);

-- æ¸…ç†è¶…è¿‡30å¤©çš„å¤±è´¥é‡è¯•è®°å½•  
DELETE FROM retry_states 
WHERE status = 'FAILED' 
  AND created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);
```

---

## 5. ğŸ“Š é‡è¯•ç›‘æ§ä¸ç»Ÿè®¡


### 5.1 é‡è¯•æŒ‡æ ‡è®¾è®¡


ç›‘æ§é‡è¯•æ•ˆæœå°±åƒä½“æ£€æŠ¥å‘Šï¼Œé€šè¿‡å„é¡¹æŒ‡æ ‡äº†è§£ç³»ç»Ÿå¥åº·çŠ¶å†µï¼š

**ğŸ“ˆ æ ¸å¿ƒæŒ‡æ ‡**ï¼š
```
é‡è¯•æˆåŠŸç‡ = é‡è¯•æˆåŠŸæ¬¡æ•° / æ€»é‡è¯•æ¬¡æ•°
é‡è¯•è§¦å‘ç‡ = éœ€è¦é‡è¯•çš„äº‹åŠ¡ / æ€»äº‹åŠ¡æ•°
å¹³å‡é‡è¯•æ¬¡æ•° = æ€»é‡è¯•æ¬¡æ•° / éœ€è¦é‡è¯•çš„äº‹åŠ¡æ•°
é‡è¯•å»¶è¿Ÿåˆ†å¸ƒ = P50, P95, P99é‡è¯•å®Œæˆæ—¶é—´
```

### 5.2 ç›‘æ§æ•°æ®æ”¶é›†


```java
@Component
public class RetryMetrics {
    private final MeterRegistry meterRegistry;
    
    // é‡è¯•è®¡æ•°å™¨
    private final Counter retryCounter;
    // é‡è¯•æˆåŠŸè®¡æ•°å™¨  
    private final Counter retrySuccessCounter;
    // é‡è¯•æ—¶é—´åˆ†å¸ƒ
    private final Timer retryTimer;
    
    public void recordRetryAttempt(String operation, int attemptNumber) {
        retryCounter.increment(
            Tags.of("operation", operation, "attempt", String.valueOf(attemptNumber))
        );
    }
    
    public void recordRetrySuccess(String operation, Duration totalTime) {
        retrySuccessCounter.increment(Tags.of("operation", operation));
        retryTimer.record(totalTime);
    }
}
```

### 5.3 é‡è¯•ç»Ÿè®¡åˆ†æ


**ğŸ“Š ç»Ÿè®¡åˆ†æç¤ºä¾‹**ï¼š
```
æ¯æ—¥é‡è¯•æŠ¥å‘Šï¼š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ€»äº‹åŠ¡æ•°ï¼š10,000
éœ€è¦é‡è¯•ï¼š500 (5%)
é‡è¯•æˆåŠŸï¼š485 (97%)
é‡è¯•å¤±è´¥ï¼š15 (3%)

é‡è¯•æ¬¡æ•°åˆ†å¸ƒï¼š
1æ¬¡é‡è¯•ï¼š300 (60%)
2æ¬¡é‡è¯•ï¼š150 (30%)  
3æ¬¡é‡è¯•ï¼š35 (7%)
4æ¬¡+é‡è¯•ï¼š15 (3%)

é‡è¯•åŸå› åˆ†æï¼š
æ­»é”ï¼š200 (40%)
è¿æ¥è¶…æ—¶ï¼š180 (36%)
é”ç­‰å¾…ï¼š120 (24%)
```

### 5.4 å‘Šè­¦è§„åˆ™é…ç½®


```yaml
é‡è¯•å‘Šè­¦è§„åˆ™:
  - é‡è¯•ç‡è¶…è¿‡10%ï¼šç«‹å³å‘Šè­¦
  - é‡è¯•æˆåŠŸç‡ä½äº95%ï¼š5åˆ†é’Ÿå†…å‘Šè­¦
  - å¹³å‡é‡è¯•æ¬¡æ•°è¶…è¿‡2ï¼šå‘Šè­¦
  - ç‰¹å®šé”™è¯¯é‡è¯•é¢‘ç‡å¼‚å¸¸ï¼šå‘Šè­¦
  
å‘Šè­¦å¤„ç†:
  - çŸ­ä¿¡é€šçŸ¥DBAå’Œå¼€å‘
  - è‡ªåŠ¨åˆ›å»ºå·¥å•
  - è§¦å‘ç´§æ€¥å¤„ç†æµç¨‹
```

---

## 6. ğŸ› ï¸ å®Œæ•´å®è·µæ¡ˆä¾‹


### 6.1 å®Œæ•´é‡è¯•æ¡†æ¶å®ç°


```java
@Service
public class TransactionRetryService {
    
    private final RetryStateRepository stateRepository;
    private final RetryMetrics metrics;
    private final ExponentialBackoff backoff;
    
    public <T> T executeWithRetry(String operationId, 
                                  Supplier<T> operation) {
        
        RetryState state = stateRepository.findByOperationId(operationId);
        if (state == null) {
            state = new RetryState(operationId);
        }
        
        while (state.getCurrentAttempt() < backoff.getMaxRetries()) {
            try {
                // è®°å½•é‡è¯•å¼€å§‹
                long startTime = System.currentTimeMillis();
                metrics.recordRetryAttempt(operationId, state.getCurrentAttempt());
                
                // æ‰§è¡Œä¸šåŠ¡æ“ä½œ
                T result = operation.get();
                
                // æˆåŠŸåæ¸…ç†çŠ¶æ€
                stateRepository.deleteByOperationId(operationId);
                metrics.recordRetrySuccess(operationId, 
                    Duration.ofMillis(System.currentTimeMillis() - startTime));
                
                return result;
                
            } catch (Exception e) {
                state.recordAttempt(e);
                
                // åˆ¤æ–­æ˜¯å¦å¯ä»¥é‡è¯•
                if (!shouldRetry(e) || 
                    state.getCurrentAttempt() >= backoff.getMaxRetries() - 1) {
                    
                    // ä¸èƒ½é‡è¯•ï¼Œä¿å­˜å¤±è´¥çŠ¶æ€
                    state.markAsFailed();
                    stateRepository.saveRetryState(state);
                    throw new RetryExhaustedException("é‡è¯•å¤±è´¥", e);
                }
                
                // è®¡ç®—ç­‰å¾…æ—¶é—´å¹¶ä¼‘çœ 
                long delay = backoff.calculateDelayWithJitter(
                    state.getCurrentAttempt());
                
                try {
                    Thread.sleep(delay);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    throw new RuntimeException("é‡è¯•è¢«ä¸­æ–­", ie);
                }
                
                // ä¿å­˜é‡è¯•çŠ¶æ€
                stateRepository.saveRetryState(state);
            }
        }
        
        throw new RetryExhaustedException("é‡è¯•æ¬¡æ•°å·²è€—å°½");
    }
}
```

### 6.2 å®é™…ä¸šåŠ¡ä½¿ç”¨ç¤ºä¾‹


```java
@Service
public class AccountService {
    
    private final TransactionRetryService retryService;
    
    // è½¬è´¦æ“ä½œä½¿ç”¨é‡è¯•
    public void transfer(String fromAccount, String toAccount, BigDecimal amount) {
        
        String operationId = "transfer_" + fromAccount + "_" + toAccount + "_" + 
                           System.currentTimeMillis();
        
        retryService.executeWithRetry(operationId, () -> {
            return performTransfer(fromAccount, toAccount, amount);
        });
    }
    
    @Transactional
    private String performTransfer(String fromAccount, String toAccount, BigDecimal amount) {
        // 1. æ£€æŸ¥ä½™é¢
        Account from = accountRepository.findByIdForUpdate(fromAccount);
        if (from.getBalance().compareTo(amount) < 0) {
            throw new InsufficientBalanceException(); // ä¸šåŠ¡å¼‚å¸¸ï¼Œä¸é‡è¯•
        }
        
        // 2. æ‰§è¡Œè½¬è´¦
        from.setBalance(from.getBalance().subtract(amount));
        accountRepository.save(from);
        
        Account to = accountRepository.findByIdForUpdate(toAccount);
        to.setBalance(to.getBalance().add(amount));
        accountRepository.save(to);
        
        // 3. è®°å½•æµæ°´
        TransactionLog log = new TransactionLog(fromAccount, toAccount, amount);
        logRepository.save(log);
        
        return log.getId();
    }
}
```

### 6.3 é…ç½®ç®¡ç†


```yaml
# application.yml
transaction:
  retry:
    # åŸºç¡€é…ç½®
    max-retries: 3
    base-delay-ms: 200
    max-delay-ms: 30000
    jitter-factor: 0.2
    
    # å¯é‡è¯•çš„é”™è¯¯ç 
    retryable-error-codes:
      - 1205  # Lock wait timeout
      - 1213  # Deadlock found
      - 1040  # Too many connections
      - 2006  # MySQL server has gone away
    
    # ç›‘æ§é…ç½®
    metrics:
      enabled: true
      export-interval: 60s
    
    # çŠ¶æ€æŒä¹…åŒ–
    persistence:
      enabled: true
      cleanup-success-after-days: 7
      cleanup-failed-after-days: 30
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡é‡è¯•æœ¬è´¨ï¼šé€šè¿‡è‡ªåŠ¨é‡æ–°å°è¯•æ¥åº”å¯¹ä¸´æ—¶æ€§æ•…éšœ
ğŸ”¸ æŒ‡æ•°é€€é¿ç­–ç•¥ï¼šé‡è¯•é—´éš”é€æ¸å¢åŠ ï¼Œé¿å…ç³»ç»Ÿå‹åŠ›è¿‡å¤§
ğŸ”¸ é‡è¯•æ¡ä»¶åˆ¤æ–­ï¼šåŒºåˆ†å¯é‡è¯•é”™è¯¯å’Œä¸å¯é‡è¯•é”™è¯¯
ğŸ”¸ çŠ¶æ€ç®¡ç†ï¼šè·Ÿè¸ªé‡è¯•è¿‡ç¨‹ï¼Œæ”¯æŒæ•…éšœæ¢å¤
ğŸ”¸ ç›‘æ§ç»Ÿè®¡ï¼šé€šè¿‡æŒ‡æ ‡åˆ†æä¼˜åŒ–é‡è¯•ç­–ç•¥
```

### 7.2 å…³é”®è®¾è®¡åŸåˆ™


**ğŸ”¹ è®¾è®¡è¦ç‚¹**ï¼š
```
å®‰å…¨æ€§ä¼˜å…ˆï¼š
- å¹‚ç­‰æ€§ä¿è¯ï¼šé‡è¯•ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨
- è¶…æ—¶æ§åˆ¶ï¼šé¿å…æ— é™ç­‰å¾…
- èµ„æºä¿æŠ¤ï¼šé‡è¯•ä¸èƒ½å‹å®ç³»ç»Ÿ

æ•ˆç‡å¹³è¡¡ï¼š
- å¿«é€Ÿå¤±è´¥ï¼šæ˜ç¡®ä¸å¯é‡è¯•çš„å¿«é€Ÿè¿”å›
- æ™ºèƒ½é€€é¿ï¼šæ ¹æ®è´Ÿè½½åŠ¨æ€è°ƒæ•´é—´éš”
- çŠ¶æ€å¤ç”¨ï¼šé¿å…é‡å¤çš„çŠ¶æ€è®¡ç®—

å¯è§‚æµ‹æ€§ï¼š
- å…¨é“¾è·¯è·Ÿè¸ªï¼šè®°å½•æ¯æ¬¡é‡è¯•çš„è¯¦ç»†ä¿¡æ¯
- æŒ‡æ ‡ç›‘æ§ï¼šå®æ—¶æŒæ¡é‡è¯•æ•ˆæœ
- å¼‚å¸¸å‘Šè­¦ï¼šåŠæ—¶å‘ç°é‡è¯•å¼‚å¸¸æ¨¡å¼
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡ä»·å€¼**ï¼š
- **ç”¨æˆ·ä½“éªŒæå‡**ï¼šå‡å°‘å› ä¸´æ—¶æ•…éšœå¯¼è‡´çš„æ“ä½œå¤±è´¥
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šæé«˜ç³»ç»Ÿå¯¹ç¬æ—¶æ•…éšœçš„å®¹é”™èƒ½åŠ›  
- **è¿ç»´æ•ˆç‡**ï¼šå‡å°‘äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨å¤„ç†å¸¸è§é—®é¢˜

**ğŸ”§ æŠ€æœ¯ä»·å€¼**ï¼š
- **é™ä½æ•…éšœå½±å“**ï¼šå°†æŠ€æœ¯æ•…éšœå¯¹ä¸šåŠ¡çš„å½±å“æœ€å°åŒ–
- **æå‡æˆåŠŸç‡**ï¼šä»95%æå‡åˆ°99%ä»¥ä¸Š
- **ä¼˜åŒ–èµ„æºåˆ©ç”¨**ï¼šé¿å…æ•…éšœæœŸé—´çš„èµ„æºæµªè´¹

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
```
é‡è¯•ä¸æ˜¯ä¸‡èƒ½è¯ï¼š
- ä¸èƒ½è§£å†³æ ¹æœ¬çš„è®¾è®¡é—®é¢˜
- å¯èƒ½æ©ç›–çœŸæ­£çš„ç³»ç»Ÿé—®é¢˜
- éœ€è¦é…åˆç›‘æ§å’Œå‘Šè­¦ä½¿ç”¨

åˆç†ä½¿ç”¨é‡è¯•ï¼š
- æ˜ç¡®é‡è¯•è¾¹ç•Œå’Œæ¡ä»¶
- è®¾ç½®åˆç†çš„é‡è¯•æ¬¡æ•°å’Œé—´éš”
- é‡è§†é‡è¯•å¯¹ç³»ç»Ÿè´Ÿè½½çš„å½±å“
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
é‡è¯•è¦æœ‰åº¦ï¼Œæ¡ä»¶è¦æ˜ç¡®
æŒ‡æ•°é€€é¿å¥½ï¼ŒæŠ–åŠ¨é˜²æƒŠç¾¤  
çŠ¶æ€è¦ä¿æŒï¼Œç›‘æ§ä¸èƒ½å°‘
ä¸šåŠ¡è¦å¹‚ç­‰ï¼Œç³»ç»Ÿè¦ç¨³å®š
```