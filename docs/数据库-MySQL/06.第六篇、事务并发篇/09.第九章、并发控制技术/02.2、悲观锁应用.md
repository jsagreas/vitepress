---
title: 2ã€æ‚²è§‚é”åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [æ‚²è§‚é”åŸºç¡€æ¦‚å¿µ](#1-æ‚²è§‚é”åŸºç¡€æ¦‚å¿µ)
2. [è¡Œé”æœºåˆ¶è¯¦è§£](#2-è¡Œé”æœºåˆ¶è¯¦è§£)
3. [è¡¨é”ç­–ç•¥åº”ç”¨](#3-è¡¨é”ç­–ç•¥åº”ç”¨)
4. [æ„å‘é”å·¥ä½œåŸç†](#4-æ„å‘é”å·¥ä½œåŸç†)
5. [é”ç­‰å¾…ä¸è¶…æ—¶å¤„ç†](#5-é”ç­‰å¾…ä¸è¶…æ—¶å¤„ç†)
6. [æ­»é”æ£€æµ‹ä¸é¢„é˜²](#6-æ­»é”æ£€æµ‹ä¸é¢„é˜²)
7. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#7-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ æ‚²è§‚é”åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ‚²è§‚é”


**æ‚²è§‚é”æ˜¯ä¸€ç§ä¿å®ˆçš„å¹¶å‘æ§åˆ¶ç­–ç•¥**ï¼Œå®ƒå‡è®¾å¹¶å‘ç¯å¢ƒä¸‹æ•°æ®å†²çªæ˜¯å¸¸è§çš„ï¼Œå› æ­¤åœ¨æ“ä½œæ•°æ®å‰å…ˆè·å–é”ã€‚

**åŸºæœ¬æ€æƒ³**ï¼š
```
æ‚²è§‚æ€ç»´ï¼šè®¤ä¸ºå…¶ä»–äººä¸€å®šä¼šä¿®æ”¹æ•°æ®
å¤„ç†æ–¹å¼ï¼šå…ˆé”å®šèµ„æºï¼Œå†è¿›è¡Œæ“ä½œ
ä¼˜ç‚¹ï¼šæ•°æ®ä¸€è‡´æ€§æœ‰ä¿éšœ
ç¼ºç‚¹ï¼šå¹¶å‘æ€§èƒ½ç›¸å¯¹è¾ƒä½
```

**ä¸ä¹è§‚é”çš„å¯¹æ¯”**ï¼š
```
æ‚²è§‚é”ç­–ç•¥ï¼š
ç”¨æˆ·A â†’ åŠ é” â†’ è¯»å– â†’ ä¿®æ”¹ â†’ é‡Šæ”¾é”
ç”¨æˆ·B â†’ ç­‰å¾… â†’ è·å¾—é” â†’ è¯»å– â†’ ä¿®æ”¹ â†’ é‡Šæ”¾é”

ä¹è§‚é”ç­–ç•¥ï¼š
ç”¨æˆ·A â†’ è¯»å–(ç‰ˆæœ¬å·v1) â†’ ä¿®æ”¹ â†’ æäº¤(æ£€æŸ¥ç‰ˆæœ¬å·)
ç”¨æˆ·B â†’ è¯»å–(ç‰ˆæœ¬å·v1) â†’ ä¿®æ”¹ â†’ æäº¤å¤±è´¥(ç‰ˆæœ¬å·å·²å˜)
```

### 1.2 MySQLä¸­çš„æ‚²è§‚é”å®ç°


MySQLé€šè¿‡**é”æœºåˆ¶**å®ç°æ‚²è§‚é”ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

**é”çš„å±‚æ¬¡ç»“æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          è¡¨çº§é”                  â”‚
â”‚  â”œâ”€â”€ è¡¨é” (Table Lock)          â”‚
â”‚  â””â”€â”€ æ„å‘é” (Intention Lock)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          è¡Œçº§é”                  â”‚
â”‚  â”œâ”€â”€ è®°å½•é” (Record Lock)       â”‚
â”‚  â”œâ”€â”€ é—´éš™é” (Gap Lock)          â”‚
â”‚  â””â”€â”€ ä¸´é”®é” (Next-Key Lock)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¸¸ç”¨çš„æ‚²è§‚é”è¯­æ³•**ï¼š
```sql
-- å…±äº«é”(Sé”)
SELECT * FROM table_name WHERE condition LOCK IN SHARE MODE;

-- æ’ä»–é”(Xé”)  
SELECT * FROM table_name WHERE condition FOR UPDATE;

-- è¡¨çº§é”
LOCK TABLES table_name READ/WRITE;
```

### 1.3 æ‚²è§‚é”çš„é€‚ç”¨åœºæ™¯


**é€‚åˆä½¿ç”¨æ‚²è§‚é”çš„æƒ…å†µ**ï¼š
- **å†™æ“ä½œé¢‘ç¹**ï¼šæ•°æ®ç»å¸¸è¢«ä¿®æ”¹
- **å†²çªæ¦‚ç‡é«˜**ï¼šå¤šä¸ªäº‹åŠ¡åŒæ—¶æ“ä½œç›¸åŒæ•°æ®
- **ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼**ï¼šä¸èƒ½å®¹å¿æ•°æ®ä¸ä¸€è‡´
- **æ“ä½œæ—¶é—´çŸ­**ï¼šé”æŒæœ‰æ—¶é—´ä¸é•¿

**å…¸å‹ä¸šåŠ¡åœºæ™¯**ï¼š
```sql
-- 1. åº“å­˜æ‰£å‡
SELECT stock FROM products WHERE id = 1001 FOR UPDATE;
UPDATE products SET stock = stock - 1 WHERE id = 1001;

-- 2. è´¦æˆ·ä½™é¢æ“ä½œ
SELECT balance FROM accounts WHERE id = 12345 FOR UPDATE;
UPDATE accounts SET balance = balance - 100 WHERE id = 12345;

-- 3. è®¢å•çŠ¶æ€å˜æ›´
SELECT status FROM orders WHERE id = 67890 FOR UPDATE;
UPDATE orders SET status = 'PROCESSING' WHERE id = 67890;
```

---

## 2. ğŸ¯ è¡Œé”æœºåˆ¶è¯¦è§£


### 2.1 è¡Œé”çš„åŸºæœ¬åŸç†


**è¡Œé”åªé”å®šè¢«è®¿é—®çš„å…·ä½“è¡Œ**ï¼Œæ˜¯InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤é”æœºåˆ¶ã€‚

**è¡Œé”çš„ç‰¹ç‚¹**ï¼š
- **é”ç²’åº¦å°**ï¼šåªé”å®šéœ€è¦çš„è¡Œï¼Œå¹¶å‘åº¦é«˜
- **å¼€é”€è¾ƒå¤§**ï¼šéœ€è¦ç»´æŠ¤å¤§é‡é”ä¿¡æ¯
- **å¯èƒ½æ­»é”**ï¼šå¤šä¸ªäº‹åŠ¡ç›¸äº’ç­‰å¾…é€ æˆæ­»é”

### 2.2 å…±äº«é”(Shared Lock)


**å…±äº«é”å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å–åŒä¸€è¡Œæ•°æ®**ã€‚

```sql
-- åŠ å…±äº«é”è¯­æ³•
SELECT * FROM users WHERE id = 100 LOCK IN SHARE MODE;
```

**å…±äº«é”ç‰¹æ€§åˆ†æ**ï¼š
```
é”å…¼å®¹æ€§ï¼š
- å…±äº«é” + å…±äº«é” = âœ… å…¼å®¹
- å…±äº«é” + æ’ä»–é” = âŒ å†²çª
- æ’ä»–é” + ä»»ä½•é” = âŒ å†²çª

å®é™…åº”ç”¨ï¼š
- ç»Ÿè®¡æŸ¥è¯¢ï¼šç¡®ä¿ç»Ÿè®¡æœŸé—´æ•°æ®ä¸è¢«ä¿®æ”¹
- æ•°æ®æ ¡éªŒï¼šéªŒè¯æ•°æ®å®Œæ•´æ€§æ—¶é˜²æ­¢ä¿®æ”¹
```

**å…±äº«é”ç¤ºä¾‹**ï¼š
```sql
-- äº‹åŠ¡Aï¼šåŠ å…±äº«é”
START TRANSACTION;
SELECT balance FROM accounts WHERE id = 1001 LOCK IN SHARE MODE;
-- å…¶ä»–äº‹åŠ¡å¯ä»¥è¯»å–ï¼Œä½†ä¸èƒ½ä¿®æ”¹

-- äº‹åŠ¡Bï¼šä¹Ÿå¯ä»¥åŠ å…±äº«é”
SELECT balance FROM accounts WHERE id = 1001 LOCK IN SHARE MODE;

-- äº‹åŠ¡Cï¼šæ’ä»–é”ä¼šè¢«é˜»å¡
SELECT balance FROM accounts WHERE id = 1001 FOR UPDATE; -- ç­‰å¾…
```

### 2.3 æ’ä»–é”(Exclusive Lock)


**æ’ä»–é”ç‹¬å è®¿é—®ï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™**ã€‚

```sql
-- åŠ æ’ä»–é”è¯­æ³•
SELECT * FROM users WHERE id = 100 FOR UPDATE;
```

**æ’ä»–é”åº”ç”¨åœºæ™¯**ï¼š
```sql
-- 1. æ•°æ®ä¿®æ”¹å‰é”å®š
START TRANSACTION;
SELECT stock FROM products WHERE id = 1001 FOR UPDATE;
-- æ£€æŸ¥åº“å­˜å……è¶³å
UPDATE products SET stock = stock - 5 WHERE id = 1001;
COMMIT;

-- 2. é˜²æ­¢é‡å¤å¤„ç†
SELECT status FROM orders WHERE id = 12345 FOR UPDATE;
-- ç¡®ä¿åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„ç†è¯¥è®¢å•
UPDATE orders SET status = 'PROCESSING' WHERE id = 12345;
```

### 2.4 è¡Œé”çš„ç´¢å¼•ä¾èµ–


**è¡Œé”å¿…é¡»é€šè¿‡ç´¢å¼•æ¥å®ç°**ï¼Œæ— ç´¢å¼•æ—¶ä¼šå‡çº§ä¸ºè¡¨é”ã€‚

```sql
-- ç¤ºä¾‹è¡¨ç»“æ„
CREATE TABLE user_accounts (
    id INT PRIMARY KEY,
    username VARCHAR(50),
    balance DECIMAL(10,2),
    INDEX idx_username (username)
);
```

**ä¸åŒæŸ¥è¯¢æ¡ä»¶çš„é”è¡Œä¸º**ï¼š
```sql
-- 1. ä¸»é”®æŸ¥è¯¢ï¼šç²¾ç¡®è¡Œé”
SELECT * FROM user_accounts WHERE id = 1001 FOR UPDATE;
-- é”å®šï¼šåªé”å®šid=1001è¿™ä¸€è¡Œ

-- 2. ç´¢å¼•æŸ¥è¯¢ï¼šç›¸å…³è¡Œé”
SELECT * FROM user_accounts WHERE username = 'john' FOR UPDATE;
-- é”å®šï¼šusername='john'çš„è¡Œ(å¯èƒ½å¤šè¡Œ)

-- 3. æ— ç´¢å¼•æŸ¥è¯¢ï¼šè¡¨é”
SELECT * FROM user_accounts WHERE balance > 1000 FOR UPDATE;
-- é”å®šï¼šæ•´ä¸ªè¡¨(å› ä¸ºbalanceæ— ç´¢å¼•)
```

**é”å‡çº§çš„å½±å“**ï¼š
```
ç´¢å¼•ä½¿ç”¨æƒ…å†µ â†’ é”ç²’åº¦
ä¸»é”®/å”¯ä¸€ç´¢å¼• â†’ ç²¾ç¡®è¡Œé”
æ™®é€šç´¢å¼• â†’ ç›¸å…³è¡Œé”  
æ— ç´¢å¼• â†’ å…¨è¡¨é”
èŒƒå›´æŸ¥è¯¢ â†’ å¤šè¡Œé”+é—´éš™é”
```

---

## 3. ğŸ“Š è¡¨é”ç­–ç•¥åº”ç”¨


### 3.1 è¡¨é”çš„åŸºæœ¬æ¦‚å¿µ


**è¡¨é”é”å®šæ•´ä¸ªè¡¨**ï¼Œæ˜¯æœ€ç²—ç²’åº¦çš„é”æœºåˆ¶ã€‚

**è¡¨é”çš„ç‰¹ç‚¹**ï¼š
- **å¼€é”€å°**ï¼šé”ç®¡ç†ç®€å•
- **åŠ é”å¿«**ï¼šä¸éœ€è¦æ£€æŸ¥è¡Œæ¡ä»¶
- **å†²çªå¤š**ï¼šæ•´è¡¨è¢«é”ï¼Œå¹¶å‘åº¦ä½
- **æ— æ­»é”**ï¼šé”ç²’åº¦å¤§ï¼Œä¸æ˜“äº§ç”Ÿæ­»é”ç¯

### 3.2 MySQLè¡¨é”ç±»å‹


**è¯»é”(Read Lock)**ï¼š
```sql
-- è¡¨çº§è¯»é”
LOCK TABLES products READ;
SELECT * FROM products WHERE category = 'electronics';
-- å½“å‰ä¼šè¯ï¼šåªèƒ½è¯»å–productsè¡¨
-- å…¶ä»–ä¼šè¯ï¼šå¯ä»¥è¯»å–ï¼Œä¸èƒ½å†™å…¥
UNLOCK TABLES;
```

**å†™é”(Write Lock)**ï¼š
```sql
-- è¡¨çº§å†™é”
LOCK TABLES products WRITE;
UPDATE products SET price = price * 1.1 WHERE category = 'electronics';
-- å½“å‰ä¼šè¯ï¼šå¯ä»¥è¯»å†™productsè¡¨
-- å…¶ä»–ä¼šè¯ï¼šæ—¢ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™
UNLOCK TABLES;
```

### 3.3 è¡¨é”çš„å…¼å®¹æ€§


**é”å…¼å®¹æ€§çŸ©é˜µ**ï¼š
```
        å½“å‰é”
è¯·æ±‚é”   READ   WRITE
READ     âœ…     âŒ
WRITE    âŒ     âŒ

è§£é‡Šï¼š
- READ + READï¼šå…¼å®¹ï¼Œå¤šä¸ªä¼šè¯å¯åŒæ—¶æŒæœ‰è¯»é”
- READ + WRITEï¼šå†²çªï¼Œè¯»å†™äº’æ–¥
- WRITE + ä»»ä½•ï¼šå†²çªï¼Œå†™é”ç‹¬å 
```

### 3.4 è¡¨é”çš„é€‚ç”¨åœºæ™¯


**é€‚åˆä½¿ç”¨è¡¨é”çš„æƒ…å†µ**ï¼š
- **å¤§æ‰¹é‡æ•°æ®æ“ä½œ**ï¼šéœ€è¦æ“ä½œè¡¨ä¸­å¤§éƒ¨åˆ†æ•°æ®
- **æ•°æ®å¤‡ä»½**ï¼šç¡®ä¿å¤‡ä»½æœŸé—´æ•°æ®ä¸€è‡´æ€§
- **æ‰¹é‡å¯¼å…¥å¯¼å‡º**ï¼šé¿å…è¿‡ç¨‹ä¸­æ•°æ®å˜åŒ–
- **ç»´æŠ¤æ“ä½œ**ï¼šè¡¨ç»“æ„ä¿®æ”¹ç­‰ç»´æŠ¤ä»»åŠ¡

**è¡¨é”åº”ç”¨ç¤ºä¾‹**ï¼š
```sql
-- 1. æ•°æ®å¤‡ä»½åœºæ™¯
LOCK TABLES orders READ, order_items READ;
-- æ‰§è¡Œæ•°æ®å¯¼å‡ºæ“ä½œ
mysqldump database_name orders order_items > backup.sql
UNLOCK TABLES;

-- 2. æ‰¹é‡æ•°æ®å¤„ç†
LOCK TABLES products WRITE;
-- æ‰¹é‡æ›´æ–°ä»·æ ¼
UPDATE products SET price = price * 1.05 WHERE category = 'books';
UPDATE products SET discount = 0.1 WHERE price > 100;
UNLOCK TABLES;
```

---

## 4. ğŸ­ æ„å‘é”å·¥ä½œåŸç†


### 4.1 æ„å‘é”çš„ä½œç”¨


**æ„å‘é”æ˜¯è¡¨çº§é”ï¼Œç”¨äºè¡¨æ˜äº‹åŠ¡å¯¹è¡¨ä¸­æŸäº›è¡Œçš„åŠ é”æ„å›¾**ã€‚

**è®¾è®¡ç›®çš„**ï¼š
- **æé«˜æ•ˆç‡**ï¼šå¿«é€Ÿåˆ¤æ–­è¡¨çº§é”æ˜¯å¦å†²çª
- **é¿å…éå†**ï¼šä¸éœ€è¦æ£€æŸ¥æ¯ä¸€è¡Œçš„é”çŠ¶æ€
- **åè°ƒæœºåˆ¶**ï¼šè¡Œé”ä¸è¡¨é”çš„åè°ƒ

### 4.2 æ„å‘é”çš„ç±»å‹


**æ„å‘å…±äº«é”(ISé”)**ï¼š
```sql
-- å½“äº‹åŠ¡å¯¹è¡ŒåŠ å…±äº«é”æ—¶ï¼Œè‡ªåŠ¨åœ¨è¡¨ä¸ŠåŠ ISé”
SELECT * FROM users WHERE id = 100 LOCK IN SHARE MODE;
-- è‡ªåŠ¨ï¼šè¡¨çº§ISé” + è¡Œçº§Sé”
```

**æ„å‘æ’ä»–é”(IXé”)**ï¼š
```sql
-- å½“äº‹åŠ¡å¯¹è¡ŒåŠ æ’ä»–é”æ—¶ï¼Œè‡ªåŠ¨åœ¨è¡¨ä¸ŠåŠ IXé”
SELECT * FROM users WHERE id = 100 FOR UPDATE;
-- è‡ªåŠ¨ï¼šè¡¨çº§IXé” + è¡Œçº§Xé”
```

### 4.3 æ„å‘é”çš„å…¼å®¹æ€§


**é”å…¼å®¹æ€§è¡¨**ï¼š
```
        ç°æœ‰é”
ç”³è¯·é”   IS    IX    S     X
IS      âœ…    âœ…    âœ…    âŒ
IX      âœ…    âœ…    âŒ    âŒ 
S       âœ…    âŒ    âœ…    âŒ
X       âŒ    âŒ    âŒ    âŒ

å…³é”®ç†è§£ï¼š
- æ„å‘é”ä¹‹é—´å…¼å®¹ï¼šISå’ŒIXå¯ä»¥å…±å­˜
- æ„å‘é”ä¸è¡¨Sé”ï¼šISå…¼å®¹ï¼ŒIXå†²çª
- æ„å‘é”ä¸è¡¨Xé”ï¼šéƒ½å†²çª
```

### 4.4 æ„å‘é”çš„å·¥ä½œæµç¨‹


**å…·ä½“å·¥ä½œè¿‡ç¨‹**ï¼š
```
Step 1ï¼šäº‹åŠ¡è¯·æ±‚è¡Œé”
äº‹åŠ¡Aï¼šSELECT * FROM users WHERE id = 100 FOR UPDATE;

Step 2ï¼šæ£€æŸ¥è¡¨çº§é”å†²çª
æ£€æŸ¥ï¼šæ˜¯å¦å­˜åœ¨ä¸IXé”å†²çªçš„è¡¨çº§é”

Step 3ï¼šåŠ æ„å‘é”
æˆåŠŸï¼šåœ¨usersè¡¨ä¸ŠåŠ IXé”

Step 4ï¼šåŠ è¡Œé”  
æˆåŠŸï¼šåœ¨id=100çš„è¡Œä¸ŠåŠ Xé”

Step 5ï¼šå…¶ä»–äº‹åŠ¡è¯·æ±‚è¡¨é”
äº‹åŠ¡Bï¼šLOCK TABLES users READ;
æ£€æŸ¥ï¼šè¡¨çº§Sé”ä¸IXé”å†²çª â†’ ç­‰å¾…
```

**æ„å‘é”çš„ä¼˜åŠ¿**ï¼š
```
æ— æ„å‘é”çš„æƒ…å†µï¼š
- è¡¨é”è¯·æ±‚éœ€è¦é€è¡Œæ£€æŸ¥é”çŠ¶æ€
- æ€§èƒ½å¼€é”€ï¼šO(è¡Œæ•°)

æœ‰æ„å‘é”çš„æƒ…å†µï¼š
- åªéœ€æ£€æŸ¥è¡¨çº§æ„å‘é”
- æ€§èƒ½å¼€é”€ï¼šO(1)
```

---

## 5. â° é”ç­‰å¾…ä¸è¶…æ—¶å¤„ç†


### 5.1 é”ç­‰å¾…æœºåˆ¶


**å½“äº‹åŠ¡æ— æ³•ç«‹å³è·å¾—é”æ—¶ï¼Œä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€**ã€‚

**ç­‰å¾…é˜Ÿåˆ—ç®¡ç†**ï¼š
```
é”æŒæœ‰è€…ï¼šäº‹åŠ¡A (æŒæœ‰æ’ä»–é”)
ç­‰å¾…é˜Ÿåˆ—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹åŠ¡B   â”‚ â†’  â”‚ äº‹åŠ¡C   â”‚ â†’  â”‚ äº‹åŠ¡D   â”‚
â”‚(ç­‰å¾…ä¸­) â”‚    â”‚(ç­‰å¾…ä¸­) â”‚    â”‚(ç­‰å¾…ä¸­) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 é”è¶…æ—¶é…ç½®


**ä¸»è¦çš„è¶…æ—¶å‚æ•°**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…è¶…æ—¶è®¾ç½®
SHOW VARIABLES LIKE 'innodb_lock_wait_timeout';
-- é»˜è®¤å€¼ï¼š50ç§’

-- è®¾ç½®é”ç­‰å¾…è¶…æ—¶æ—¶é—´
SET SESSION innodb_lock_wait_timeout = 10; -- 10ç§’
SET GLOBAL innodb_lock_wait_timeout = 30;  -- å…¨å±€30ç§’
```

**è¶…æ—¶å¤„ç†ç¤ºä¾‹**ï¼š
```sql
-- äº‹åŠ¡Aï¼šæŒæœ‰é”
START TRANSACTION;
SELECT * FROM accounts WHERE id = 1001 FOR UPDATE;
-- é•¿æ—¶é—´ä¸é‡Šæ”¾é”

-- äº‹åŠ¡Bï¼šç­‰å¾…é”
START TRANSACTION;
SELECT * FROM accounts WHERE id = 1001 FOR UPDATE;
-- ERROR 1205: Lock wait timeout exceeded
```

### 5.3 é”ç­‰å¾…ç›‘æ§


**æŸ¥çœ‹é”ç­‰å¾…æƒ…å†µ**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰é”çŠ¶æ€
SHOW ENGINE INNODB STATUS;

-- æŸ¥çœ‹é”ç­‰å¾…ä¿¡æ¯(MySQL 5.7+)
SELECT * FROM performance_schema.data_locks;
SELECT * FROM performance_schema.data_lock_waits;

-- æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
SHOW PROCESSLIST;
```

**é”ç­‰å¾…ä¿¡æ¯è§£è¯»**ï¼š
```sql
-- ç¤ºä¾‹è¾“å‡º
SELECT 
    waiting_pid,
    waiting_query,
    blocking_pid,
    blocking_query,
    wait_age
FROM sys.innodb_lock_waits;

-- ç»“æœè§£é‡Šï¼š
-- waiting_pid: ç­‰å¾…çš„è¿›ç¨‹ID
-- blocking_pid: é˜»å¡çš„è¿›ç¨‹ID  
-- wait_age: ç­‰å¾…æ—¶é•¿
```

### 5.4 é”ç­‰å¾…ä¼˜åŒ–ç­–ç•¥


**å‡å°‘é”ç­‰å¾…çš„æ–¹æ³•**ï¼š
```sql
-- 1. ç¼©çŸ­äº‹åŠ¡æ—¶é—´
START TRANSACTION;
SELECT * FROM accounts WHERE id = 1001 FOR UPDATE;
-- ç«‹å³è¿›è¡Œä¸šåŠ¡é€»è¾‘ï¼Œé¿å…é•¿æ—¶é—´æŒé”
UPDATE accounts SET balance = balance - 100 WHERE id = 1001;
COMMIT; -- å°½å¿«æäº¤

-- 2. è°ƒæ•´é”ç­‰å¾…è¶…æ—¶
SET SESSION innodb_lock_wait_timeout = 5; -- å¿«é€Ÿå¤±è´¥

-- 3. ä½¿ç”¨é€‚å½“çš„ç´¢å¼•
-- ç¡®ä¿æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼Œé¿å…é”å‡çº§
ALTER TABLE accounts ADD INDEX idx_account_no (account_no);
```

---

## 6. âš ï¸ æ­»é”æ£€æµ‹ä¸é¢„é˜²


### 6.1 æ­»é”çš„äº§ç”ŸåŸç†


**æ­»é”æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”çš„ç°è±¡**ã€‚

**ç»å…¸æ­»é”åœºæ™¯**ï¼š
```sql
-- æ—¶é—´è½´ï¼š
-- T1: äº‹åŠ¡Aé”å®šè¡Œ1
-- T2: äº‹åŠ¡Bé”å®šè¡Œ2  
-- T3: äº‹åŠ¡Aè¯·æ±‚é”å®šè¡Œ2 (ç­‰å¾…äº‹åŠ¡B)
-- T4: äº‹åŠ¡Bè¯·æ±‚é”å®šè¡Œ1 (ç­‰å¾…äº‹åŠ¡A)
-- ç»“æœï¼šæ­»é”å½¢æˆ

äº‹åŠ¡Aï¼š
START TRANSACTION;
UPDATE accounts SET balance = balance - 100 WHERE id = 1001; -- é”å®šè¡Œ1
-- ç­‰å¾…...
UPDATE accounts SET balance = balance + 100 WHERE id = 1002; -- ç­‰å¾…è¡Œ2

äº‹åŠ¡Bï¼š  
START TRANSACTION;
UPDATE accounts SET balance = balance - 50 WHERE id = 1002;  -- é”å®šè¡Œ2
-- ç­‰å¾…...
UPDATE accounts SET balance = balance + 50 WHERE id = 1001;  -- ç­‰å¾…è¡Œ1
```

### 6.2 MySQLæ­»é”æ£€æµ‹æœºåˆ¶


**InnoDBçš„æ­»é”æ£€æµ‹**ï¼š
- **è‡ªåŠ¨æ£€æµ‹**ï¼šæŒç»­ç›‘æ§é”ç­‰å¾…å›¾
- **æ­»é”è§£é™¤**ï¼šé€‰æ‹©ä¸€ä¸ªäº‹åŠ¡å›æ»š
- **é€‰æ‹©ç­–ç•¥**ï¼šé€šå¸¸å›æ»šä»£ä»·è¾ƒå°çš„äº‹åŠ¡

```sql
-- æ­»é”æ£€æµ‹ç›¸å…³å‚æ•°
SHOW VARIABLES LIKE 'innodb_deadlock_detect';
-- ONï¼šå¼€å¯æ­»é”æ£€æµ‹(æ¨è)
-- OFFï¼šå…³é—­æ­»é”æ£€æµ‹(å¯èƒ½å¯¼è‡´è¶…æ—¶)

-- æ­»é”ç­‰å¾…å›¾æ£€æµ‹å‘¨æœŸ
SHOW VARIABLES LIKE 'innodb_deadlock_detect_frequency';
```

### 6.3 æ­»é”ä¿¡æ¯æŸ¥çœ‹


**æŸ¥çœ‹æœ€è¿‘çš„æ­»é”ä¿¡æ¯**ï¼š
```sql
-- æŸ¥çœ‹æ­»é”è¯¦æƒ…
SHOW ENGINE INNODB STATUS;

-- æ­»é”ä¿¡æ¯åŒ…å«ï¼š
-- 1. å‚ä¸æ­»é”çš„äº‹åŠ¡ä¿¡æ¯
-- 2. æ¯ä¸ªäº‹åŠ¡æŒæœ‰å’Œç­‰å¾…çš„é”
-- 3. è¢«å›æ»šçš„äº‹åŠ¡
-- 4. æ­»é”æ£€æµ‹çš„æ—¶é—´æˆ³
```

**æ­»é”æ—¥å¿—ç¤ºä¾‹**ï¼š
```
LATEST DETECTED DEADLOCK
------------------------
2024-09-06 16:30:15
*** (1) TRANSACTION:
TRANSACTION 12345, ACTIVE 10 sec starting index read
mysql tables in use 1, locked 1
LOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 15, OS thread handle 140123456789, query id 789
localhost root updating
UPDATE accounts SET balance = balance + 100 WHERE id = 1002

*** (2) TRANSACTION:
TRANSACTION 12346, ACTIVE 8 sec starting index read  
mysql tables in use 1, locked 1
3 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 16, OS thread handle 140123456790, query id 790
localhost root updating
UPDATE accounts SET balance = balance + 50 WHERE id = 1001
*** WE ROLL BACK TRANSACTION (2)
```

### 6.4 æ­»é”é¢„é˜²ç­–ç•¥


**é¿å…æ­»é”çš„æ–¹æ³•**ï¼š

**1. ç»Ÿä¸€é”å®šé¡ºåº**ï¼š
```sql
-- é”™è¯¯åšæ³•ï¼šä¸åŒé¡ºåºé”å®š
äº‹åŠ¡Aï¼šé”å®šid=1001ï¼Œå†é”å®šid=1002
äº‹åŠ¡Bï¼šé”å®šid=1002ï¼Œå†é”å®šid=1001

-- æ­£ç¡®åšæ³•ï¼šç»Ÿä¸€é¡ºåºé”å®š  
äº‹åŠ¡Aï¼šé”å®šid=1001ï¼Œå†é”å®šid=1002
äº‹åŠ¡Bï¼šé”å®šid=1001ï¼Œå†é”å®šid=1002 (æŒ‰IDå‡åº)
```

**2. ç¼©çŸ­äº‹åŠ¡æ—¶é—´**ï¼š
```sql
-- é¿å…é•¿äº‹åŠ¡
START TRANSACTION;
-- ç«‹å³è·å–æ‰€éœ€çš„é”
SELECT * FROM accounts WHERE id IN (1001, 1002) FOR UPDATE;
-- å¿«é€Ÿå®Œæˆä¸šåŠ¡é€»è¾‘
UPDATE accounts SET balance = balance - 100 WHERE id = 1001;
UPDATE accounts SET balance = balance + 100 WHERE id = 1002;
COMMIT; -- å°½å¿«é‡Šæ”¾é”
```

**3. ä½¿ç”¨è¾ƒä½çš„éš”ç¦»çº§åˆ«**ï¼š
```sql
-- åœ¨ä¸šåŠ¡å…è®¸çš„æƒ…å†µä¸‹ä½¿ç”¨READ COMMITTED
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
-- å‡å°‘é—´éš™é”çš„ä½¿ç”¨ï¼Œé™ä½æ­»é”æ¦‚ç‡
```

**4. åˆç†è®¾è®¡ç´¢å¼•**ï¼š
```sql
-- ç¡®ä¿æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼Œå‡å°‘é”èŒƒå›´
CREATE INDEX idx_account_status ON accounts(status, id);
-- é¿å…å…¨è¡¨æ‰«æé€ æˆçš„å¤§èŒƒå›´é”å®š
```

---

## 7. ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 7.1 é”ç²’åº¦é€‰æ‹©ç­–ç•¥


**é€‰æ‹©åˆé€‚çš„é”ç²’åº¦**ï¼š

```
ä¸šåŠ¡åœºæ™¯ â†’ æ¨èé”ç²’åº¦
å•è¡Œæ“ä½œ â†’ è¡Œé”
èŒƒå›´æ“ä½œ(å°) â†’ è¡Œé”+é—´éš™é”
èŒƒå›´æ“ä½œ(å¤§) â†’ è¡¨é”  
æ‰¹é‡æ“ä½œ â†’ è¡¨é”
è¯»å¤šå†™å°‘ â†’ å…±äº«é”
å†™å¤šè¯»å°‘ â†’ æ’ä»–é”
```

**é”ç²’åº¦å¯¹æ¯”**ï¼š
```sql
-- ç²¾ç¡®è¡Œé”ï¼šé«˜å¹¶å‘ï¼Œä½å†²çª
SELECT * FROM orders WHERE id = 12345 FOR UPDATE;

-- èŒƒå›´è¡Œé”ï¼šä¸­ç­‰å¹¶å‘ï¼Œä¸­ç­‰å†²çª
SELECT * FROM orders WHERE create_time >= '2024-09-01' FOR UPDATE;

-- è¡¨é”ï¼šä½å¹¶å‘ï¼Œé«˜æ•ˆç‡
LOCK TABLES orders WRITE;
UPDATE orders SET status = 'ARCHIVED' WHERE create_time < '2024-01-01';
UNLOCK TABLES;
```

### 7.2 ç´¢å¼•ä¼˜åŒ–å¯¹é”çš„å½±å“


**ç´¢å¼•å¯¹é”æ€§èƒ½çš„å½±å“**ï¼š

```sql
-- æ— ç´¢å¼•ï¼šå…¨è¡¨é”
EXPLAIN SELECT * FROM orders WHERE customer_name = 'John' FOR UPDATE;
-- type: ALL, Extra: Using where
-- é”å®šï¼šæ•´ä¸ªè¡¨

-- æœ‰ç´¢å¼•ï¼šç²¾ç¡®è¡Œé”
ALTER TABLE orders ADD INDEX idx_customer_name (customer_name);
EXPLAIN SELECT * FROM orders WHERE customer_name = 'John' FOR UPDATE;  
-- type: ref, Extra: Using index condition
-- é”å®šï¼šåŒ¹é…çš„è¡Œ
```

**ç´¢å¼•ä¼˜åŒ–å»ºè®®**ï¼š
```sql
-- 1. ä¸ºWHEREæ¡ä»¶åˆ›å»ºç´¢å¼•
CREATE INDEX idx_status_date ON orders(status, create_date);

-- 2. ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨
CREATE INDEX idx_cover ON orders(status, id, amount);
SELECT id, amount FROM orders WHERE status = 'PENDING' FOR UPDATE;

-- 3. é¿å…åœ¨é”å®šæŸ¥è¯¢ä¸­ä½¿ç”¨å‡½æ•°
-- é”™è¯¯ï¼šWHERE DATE(create_time) = '2024-09-06'
-- æ­£ç¡®ï¼šWHERE create_time >= '2024-09-06' AND create_time < '2024-09-07'
```

### 7.3 äº‹åŠ¡è®¾è®¡ä¼˜åŒ–


**ä¼˜åŒ–äº‹åŠ¡è®¾è®¡**ï¼š

```sql
-- 1. å‡å°‘äº‹åŠ¡ä¸­çš„éDBæ“ä½œ
-- é”™è¯¯åšæ³•ï¼š
START TRANSACTION;
SELECT * FROM accounts WHERE id = 1001 FOR UPDATE;
-- è°ƒç”¨å¤–éƒ¨API (è€—æ—¶æ“ä½œ)
call_external_api();
UPDATE accounts SET balance = balance - 100 WHERE id = 1001;
COMMIT;

-- æ­£ç¡®åšæ³•ï¼š
-- å…ˆè°ƒç”¨å¤–éƒ¨API
result = call_external_api();
-- å†è¿›è¡ŒDBäº‹åŠ¡
START TRANSACTION;
SELECT * FROM accounts WHERE id = 1001 FOR UPDATE;
UPDATE accounts SET balance = balance - 100 WHERE id = 1001;
COMMIT;
```

**2. æ‰¹é‡æ“ä½œä¼˜åŒ–**ï¼š
```sql
-- åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®
DELIMITER $$
CREATE PROCEDURE batch_update()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE batch_size INT DEFAULT 1000;
    
    REPEAT
        START TRANSACTION;
        UPDATE orders SET status = 'PROCESSED' 
        WHERE status = 'PENDING' 
        LIMIT batch_size;
        
        SET done = (ROW_COUNT() < batch_size);
        COMMIT;
    UNTIL done END REPEAT;
END$$
DELIMITER ;
```

### 7.4 ç›‘æ§ä¸è°ƒä¼˜


**æ€§èƒ½ç›‘æ§æŒ‡æ ‡**ï¼š
```sql
-- 1. é”ç­‰å¾…ç»Ÿè®¡
SELECT 
    COUNT(*) as lock_waits,
    AVG(wait_time) as avg_wait_time
FROM performance_schema.events_waits_history 
WHERE event_name LIKE '%lock%';

-- 2. æ­»é”ç»Ÿè®¡
SHOW ENGINE INNODB STATUS;
-- æŸ¥çœ‹ "DEADLOCKS" éƒ¨åˆ†çš„ç»Ÿè®¡ä¿¡æ¯

-- 3. é”äº‰ç”¨åˆ†æ
SELECT 
    object_schema,
    object_name,
    COUNT(*) as lock_count
FROM performance_schema.data_locks
GROUP BY object_schema, object_name
ORDER BY lock_count DESC;
```

**æ€§èƒ½è°ƒä¼˜å‚æ•°**ï¼š
```sql
-- è°ƒæ•´é”ç›¸å…³å‚æ•°
SET GLOBAL innodb_lock_wait_timeout = 10;        -- é”ç­‰å¾…è¶…æ—¶
SET GLOBAL innodb_deadlock_detect = ON;          -- æ­»é”æ£€æµ‹
SET GLOBAL innodb_thread_concurrency = 0;        -- å¹¶å‘çº¿ç¨‹æ•°
SET GLOBAL innodb_concurrency_tickets = 5000;    -- å¹¶å‘ç¥¨æ•°
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ‚²è§‚é”æ€æƒ³ï¼šå‡è®¾å†²çªå¸¸è§ï¼Œæå‰åŠ é”é˜²æ­¢å†²çª
ğŸ”¸ è¡Œé”æœºåˆ¶ï¼šé”å®šå…·ä½“è¡Œï¼Œæä¾›æœ€ä½³å¹¶å‘æ€§èƒ½
ğŸ”¸ è¡¨é”ç­–ç•¥ï¼šé”å®šæ•´è¡¨ï¼Œé€‚åˆæ‰¹é‡æ“ä½œåœºæ™¯
ğŸ”¸ æ„å‘é”ä½œç”¨ï¼šåè°ƒè¡Œé”ä¸è¡¨é”ï¼Œæé«˜åˆ¤æ–­æ•ˆç‡
ğŸ”¸ é”ç­‰å¾…å¤„ç†ï¼šåˆç†è®¾ç½®è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡
ğŸ”¸ æ­»é”é¢„é˜²ï¼šç»Ÿä¸€é”é¡ºåºï¼Œç¼©çŸ­äº‹åŠ¡æ—¶é—´
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä½•æ—¶ä½¿ç”¨æ‚²è§‚é”**
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… å¹¶å‘å†™æ“ä½œé¢‘ç¹
âœ… æ•°æ®å†²çªæ¦‚ç‡é«˜  
âœ… ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼
âœ… æ“ä½œæ—¶é—´è¾ƒçŸ­

ä¸é€‚ç”¨åœºæ™¯ï¼š
âŒ è¯»å¤šå†™å°‘çš„åœºæ™¯
âŒ é•¿æ—¶é—´çš„æ•°æ®å¤„ç†
âŒ å¯¹å¹¶å‘æ€§èƒ½è¦æ±‚æé«˜
âŒ åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„è·¨åº“æ“ä½œ
```

**ğŸ”¹ é”ç²’åº¦çš„é€‰æ‹©åŸåˆ™**
```
é€‰æ‹©ä¾æ®ï¼š
- æ“ä½œèŒƒå›´ï¼šå•è¡Œç”¨è¡Œé”ï¼Œå¤§æ‰¹é‡ç”¨è¡¨é”
- å¹¶å‘éœ€æ±‚ï¼šé«˜å¹¶å‘ç”¨ç»†ç²’åº¦é”
- å†²çªæ¦‚ç‡ï¼šé«˜å†²çªå¯è€ƒè™‘ç²—ç²’åº¦é”
- æ€§èƒ½è¦æ±‚ï¼šå¹³è¡¡é”å¼€é”€ä¸å¹¶å‘åº¦
```

**ğŸ”¹ æ­»é”é—®é¢˜çš„æ ¹æœ¬è§£å†³**
```
é¢„é˜²ç­–ç•¥ï¼š
1. åº”ç”¨å±‚ï¼šç»Ÿä¸€èµ„æºè®¿é—®é¡ºåº
2. æ•°æ®åº“å±‚ï¼šåˆç†è®¾è®¡ç´¢å¼•å’ŒæŸ¥è¯¢
3. äº‹åŠ¡å±‚ï¼šç¼©çŸ­äº‹åŠ¡æ—¶é—´ï¼Œå‡å°‘é”æŒæœ‰
4. ç›‘æ§å±‚ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†æ­»é”é—®é¢˜
```

### 8.3 å®è·µåº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ‚²è§‚é”çš„æœ€ä½³å®è·µ**
```sql
-- 1. æ˜ç¡®é”çš„ç›®çš„å’ŒèŒƒå›´
START TRANSACTION;
-- åªé”å®šå¿…è¦çš„è¡Œ
SELECT balance FROM accounts WHERE id = ? FOR UPDATE;
-- å¿«é€Ÿå®Œæˆä¸šåŠ¡é€»è¾‘
IF balance >= amount THEN
    UPDATE accounts SET balance = balance - amount WHERE id = ?;
END IF;
COMMIT;

-- 2. åˆç†ä½¿ç”¨ç´¢å¼•
-- ç¡®ä¿é”å®šæŸ¥è¯¢ä½¿ç”¨ç´¢å¼•
EXPLAIN SELECT * FROM orders WHERE status = ? FOR UPDATE;

-- 3. é¿å…é”å‡çº§
-- ä½¿ç”¨ç²¾ç¡®æ¡ä»¶é¿å…æ— ç´¢å¼•æŸ¥è¯¢
SELECT * FROM products WHERE id = ? FOR UPDATE;  -- ç²¾ç¡®
-- è€Œä¸æ˜¯ WHERE name LIKE '%keyword%' FOR UPDATE; -- èŒƒå›´
```

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç‚¹**
```
ä¼˜åŒ–æ–¹å‘ï¼š
1. å‡å°‘é”æŒæœ‰æ—¶é—´ï¼šäº‹åŠ¡å°½å¯èƒ½çŸ­
2. å‡å°‘é”å†²çªèŒƒå›´ï¼šç²¾ç¡®çš„WHEREæ¡ä»¶
3. åˆç†é€‰æ‹©é”ç±»å‹ï¼šå…±äº«é” vs æ’ä»–é”
4. ç›‘æ§é”äº‰ç”¨æƒ…å†µï¼šåŠæ—¶å‘ç°æ€§èƒ½ç“¶é¢ˆ
```

**ğŸ¯ ç›‘æ§å’Œæ•…éšœå¤„ç†**
```sql
-- æ—¥å¸¸ç›‘æ§è„šæœ¬
SELECT 
    'Lock Waits' as metric,
    COUNT(*) as count
FROM information_schema.PROCESSLIST 
WHERE STATE LIKE '%lock%'
UNION ALL
SELECT 
    'Long Transactions' as metric,
    COUNT(*) as count  
FROM information_schema.PROCESSLIST
WHERE TIME > 30;

-- ç´§æ€¥å¤„ç†é•¿æ—¶é—´é”ç­‰å¾…
SHOW PROCESSLIST;
-- æ‰¾åˆ°é˜»å¡çš„è¿›ç¨‹ID
KILL QUERY process_id; -- ç»ˆæ­¢æŸ¥è¯¢
-- æˆ– KILL process_id; -- ç»ˆæ­¢è¿æ¥
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**ğŸ”§ é”ç­‰å¾…è¶…æ—¶**
```
é—®é¢˜ç°è±¡ï¼šERROR 1205: Lock wait timeout exceeded
è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥æ˜¯å¦æœ‰é•¿æ—¶é—´æœªæäº¤çš„äº‹åŠ¡
2. ä¼˜åŒ–æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•å‡å°‘é”èŒƒå›´  
3. è°ƒæ•´innodb_lock_wait_timeoutå‚æ•°
4. é‡æ„ä¸šåŠ¡é€»è¾‘å‡å°‘é”å†²çª
```

**ğŸ”§ æ­»é”é¢‘ç¹å‘ç”Ÿ**  
```
é—®é¢˜ç°è±¡ï¼šERROR 1213: Deadlock found when trying to get lock
è§£å†³æ–¹æ¡ˆï¼š
1. åˆ†ææ­»é”æ—¥å¿—æ‰¾å‡ºå†²çªæ¨¡å¼
2. ç»Ÿä¸€åº”ç”¨ä¸­çš„èµ„æºè®¿é—®é¡ºåº
3. æ‹†åˆ†å¤§äº‹åŠ¡ä¸ºå°äº‹åŠ¡
4. è€ƒè™‘ä½¿ç”¨ä¹è§‚é”æ›¿ä»£
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> æ‚²è§‚åŠ é”é˜²å†²çªï¼Œè¡Œé”è¡¨é”é€‰ç²’åº¦  
> æ„å‘é”åšåè°ƒå‘˜ï¼Œç­‰å¾…è¶…æ—¶è¦è®¾åº¦  
> æ­»é”æ£€æµ‹è‡ªåŠ¨åŒ–ï¼Œç»Ÿä¸€é¡ºåºæ˜¯å‡ºè·¯  
> ç´¢å¼•ä¼˜åŒ–é”èŒƒå›´ï¼Œäº‹åŠ¡è¦çŸ­æ€§èƒ½è¶³