---
title: 4ã€çº¦æŸå†²çªå¤„ç†æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [çº¦æŸå†²çªæ¦‚è¿°](#1-çº¦æŸå†²çªæ¦‚è¿°)
2. [çº¦æŸå†²çªæ£€æµ‹æœºåˆ¶](#2-çº¦æŸå†²çªæ£€æµ‹æœºåˆ¶)
3. [å†²çªè¯Šæ–­ä¸é”™è¯¯ä»£ç åˆ†æ](#3-å†²çªè¯Šæ–­ä¸é”™è¯¯ä»£ç åˆ†æ)
4. [çº¦æŸå†²çªå¤„ç†æµç¨‹](#4-çº¦æŸå†²çªå¤„ç†æµç¨‹)
5. [æ•°æ®ä¿®å¤ç­–ç•¥ä¸è§£å†³æ–¹æ¡ˆ](#5-æ•°æ®ä¿®å¤ç­–ç•¥ä¸è§£å†³æ–¹æ¡ˆ)
6. [çº¦æŸå†²çªè‡ªåŠ¨ä¿®å¤æœºåˆ¶](#6-çº¦æŸå†²çªè‡ªåŠ¨ä¿®å¤æœºåˆ¶)
7. [ç›‘æ§é€šçŸ¥ä¸é¢„é˜²æœºåˆ¶](#7-ç›‘æ§é€šçŸ¥ä¸é¢„é˜²æœºåˆ¶)
8. [æ‰¹é‡æ•°æ®çº¦æŸå¤„ç†](#8-æ‰¹é‡æ•°æ®çº¦æŸå¤„ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ çº¦æŸå†²çªæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯çº¦æŸå†²çªï¼Ÿ


**ğŸ”¸ çº¦æŸå†²çªçš„åŸºæœ¬æ¦‚å¿µ**
çº¦æŸå†²çªå°±æ˜¯å½“æˆ‘ä»¬è¦å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œæ—¶ï¼Œ**æ–°çš„æ•°æ®è¿åäº†å·²ç»è®¾å®šçš„çº¦æŸè§„åˆ™**ï¼š

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
æƒ³è±¡æ•°æ®åº“çº¦æŸå°±åƒäº¤é€šè§„åˆ™
ğŸš¦ çº¢ç¯åœï¼Œç»¿ç¯è¡Œï¼ˆçº¦æŸè§„åˆ™ï¼‰
ğŸš— é—¯çº¢ç¯ï¼ˆè¿åçº¦æŸï¼‰
ğŸš” è¢«æ‹¦ä¸‹å¤„ç½šï¼ˆçº¦æŸå†²çªå¤„ç†ï¼‰

æ•°æ®åº“ä¸­çš„ä¾‹å­ï¼š
çº¦æŸï¼šå­¦å·å¿…é¡»å”¯ä¸€
æ“ä½œï¼šæ’å…¥å­¦å·ä¸º"001"çš„æ–°å­¦ç”Ÿ  
å†²çªï¼šæ•°æ®åº“ä¸­å·²å­˜åœ¨å­¦å·"001"
ç»“æœï¼šæ“ä½œè¢«æ‹’ç»ï¼ŒæŠ¥é”™æç¤º
```

### 1.2 çº¦æŸå†²çªçš„å¸¸è§ç±»å‹


**ğŸ”¸ ä¸»é”®å†²çª**
```
åœºæ™¯ï¼šæ’å…¥é‡å¤çš„ä¸»é”®å€¼
ä¾‹å­ï¼š
ç°æœ‰æ•°æ®ï¼šå­¦å· 001 - å¼ ä¸‰
å°è¯•æ’å…¥ï¼šå­¦å· 001 - æå››
ç»“æœï¼šâŒ ä¸»é”®é‡å¤é”™è¯¯
```

**ğŸ”¸ å¤–é”®å†²çª**
```
åœºæ™¯ï¼šå¤–é”®å¼•ç”¨ä¸å­˜åœ¨çš„å€¼
ä¾‹å­ï¼š
å­¦ç”Ÿè¡¨ä¸­å­˜åœ¨ï¼šå­¦å· 001, 002, 003
é€‰è¯¾è¡¨å°è¯•æ’å…¥ï¼šå­¦å· 999, è¯¾ç¨‹ C001
ç»“æœï¼šâŒ å¤–é”®çº¦æŸè¿åï¼Œå­¦å·999ä¸å­˜åœ¨
```

**ğŸ”¸ å”¯ä¸€æ€§å†²çª**
```
åœºæ™¯ï¼šè¿åUNIQUEçº¦æŸ
ä¾‹å­ï¼š
çº¦æŸï¼šèº«ä»½è¯å·å”¯ä¸€
å°è¯•æ’å…¥ï¼šç›¸åŒèº«ä»½è¯å·çš„ä¸åŒäºº
ç»“æœï¼šâŒ å”¯ä¸€æ€§çº¦æŸè¿å
```

**ğŸ”¸ æ£€æŸ¥çº¦æŸå†²çª**
```
åœºæ™¯ï¼šæ•°æ®ä¸æ»¡è¶³CHECKçº¦æŸ
ä¾‹å­ï¼š
çº¦æŸï¼šå¹´é¾„ BETWEEN 0 AND 120
å°è¯•æ’å…¥ï¼šå¹´é¾„ = -5 æˆ– 150
ç»“æœï¼šâŒ æ£€æŸ¥çº¦æŸè¿å
```

### 1.3 çº¦æŸå†²çªçš„å½±å“


**ğŸ”¸ å¯¹ç³»ç»Ÿçš„å½±å“**
```
æ•°æ®å±‚é¢ï¼š
â€¢ æ•°æ®æ’å…¥/æ›´æ–°å¤±è´¥
â€¢ æ•°æ®ä¸€è‡´æ€§å¯èƒ½å—å¨èƒ
â€¢ ä¸šåŠ¡æµç¨‹ä¸­æ–­

åº”ç”¨å±‚é¢ï¼š
â€¢ ç”¨æˆ·æ“ä½œå¤±è´¥ï¼Œä½“éªŒå·®
â€¢ ä¸šåŠ¡é€»è¾‘éœ€è¦å¤„ç†å¼‚å¸¸
â€¢ å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±

è¿ç»´å±‚é¢ï¼š
â€¢ éœ€è¦äººå·¥ä»‹å…¥å¤„ç†
â€¢ å¢åŠ ç³»ç»Ÿç»´æŠ¤æˆæœ¬
â€¢ å½±å“ç³»ç»Ÿç¨³å®šæ€§
```

---

## 2. ğŸ” çº¦æŸå†²çªæ£€æµ‹æœºåˆ¶


### 2.1 æ•°æ®åº“è‡ªåŠ¨æ£€æµ‹


**ğŸ”¸ å®æ—¶æ£€æµ‹æœºåˆ¶**
æ•°æ®åº“ç®¡ç†ç³»ç»Ÿåœ¨æ¯æ¬¡æ•°æ®æ“ä½œæ—¶éƒ½ä¼š**è‡ªåŠ¨æ£€æŸ¥çº¦æŸ**ï¼š

```
æ£€æµ‹æ—¶æœºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INSERT    â”‚ â†’ â”‚ çº¦æŸæ£€æŸ¥     â”‚ â†’ â”‚ æˆåŠŸ/å¤±è´¥   â”‚
â”‚   UPDATE    â”‚    â”‚ (è‡ªåŠ¨è§¦å‘)   â”‚    â”‚             â”‚
â”‚   DELETE    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ£€æµ‹æµç¨‹ï¼š
1. ç”¨æˆ·å‘èµ·æ•°æ®æ“ä½œ
2. æ•°æ®åº“è§£æSQLè¯­å¥
3. æ£€æŸ¥æ‰€æœ‰ç›¸å…³çº¦æŸ
4. çº¦æŸé€šè¿‡ â†’ æ‰§è¡Œæ“ä½œ
5. çº¦æŸå¤±è´¥ â†’ å›æ»šå¹¶æŠ¥é”™
```

**ğŸ”¸ çº¦æŸæ£€æŸ¥çš„ä¼˜å…ˆçº§**
```
æ£€æŸ¥é¡ºåºï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. ğŸ”´ è¯­æ³•æ£€æŸ¥ï¼šSQLè¯­å¥æ˜¯å¦æ­£ç¡®
2. ğŸŸ¡ æƒé™æ£€æŸ¥ï¼šç”¨æˆ·æ˜¯å¦æœ‰æ“ä½œæƒé™
3. ğŸŸ  æ•°æ®ç±»å‹æ£€æŸ¥ï¼šç±»å‹æ˜¯å¦åŒ¹é…
4. ğŸ”µ çº¦æŸæ£€æŸ¥ï¼šæ˜¯å¦è¿åå®Œæ•´æ€§çº¦æŸ
5. ğŸŸ¢ æ‰§è¡Œæ“ä½œï¼šæ‰€æœ‰æ£€æŸ¥é€šè¿‡åæ‰§è¡Œ
```

### 2.2 çº¦æŸæ£€æŸ¥çš„æŠ€æœ¯å®ç°


**ğŸ”¸ çº¦æŸæ£€æŸ¥ç®—æ³•**
```
ä¼ªä»£ç ç¤ºä¾‹ï¼š
function checkConstraints(operation, data) {
    // 1. æ£€æŸ¥éç©ºçº¦æŸ
    if (hasNullConstraint(column) && data[column] == null) {
        throw new NotNullViolationError();
    }
    
    // 2. æ£€æŸ¥ä¸»é”®çº¦æŸ
    if (operation == 'INSERT' && primaryKeyExists(data.primaryKey)) {
        throw new PrimaryKeyViolationError();
    }
    
    // 3. æ£€æŸ¥å¤–é”®çº¦æŸ
    for (foreignKey in data.foreignKeys) {
        if (!referenceExists(foreignKey)) {
            throw new ForeignKeyViolationError();
        }
    }
    
    // 4. æ£€æŸ¥å”¯ä¸€æ€§çº¦æŸ
    if (uniqueValueExists(data.uniqueColumns)) {
        throw new UniqueViolationError();
    }
    
    // 5. æ£€æŸ¥CHECKçº¦æŸ
    if (!validateCheckConstraints(data)) {
        throw new CheckViolationError();
    }
    
    return true; // æ‰€æœ‰çº¦æŸæ£€æŸ¥é€šè¿‡
}
```

### 2.3 çº¦æŸè¿åæ—¥å¿—


**ğŸ”¸ æ—¥å¿—è®°å½•æœºåˆ¶**
å½“çº¦æŸå†²çªå‘ç”Ÿæ—¶ï¼Œæ•°æ®åº“ä¼š**è¯¦ç»†è®°å½•å†²çªä¿¡æ¯**ï¼š

```
å…¸å‹çº¦æŸè¿åæ—¥å¿—æ ¼å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´: 2025-09-01 10:30:15                      â”‚
â”‚ é”™è¯¯ç±»å‹: PRIMARY_KEY_VIOLATION                 â”‚
â”‚ è¡¨å: students                                  â”‚
â”‚ çº¦æŸå: pk_student_id                          â”‚
â”‚ å†²çªå­—æ®µ: student_id                           â”‚
â”‚ å†²çªå€¼: '001'                                  â”‚
â”‚ SQLè¯­å¥: INSERT INTO students VALUES('001'...) â”‚
â”‚ é”™è¯¯è¯¦æƒ…: ä¸»é”®å€¼'001'å·²å­˜åœ¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ æ—¥å¿—åˆ†æä»·å€¼**
```
è¿ç»´ä»·å€¼ï¼š
â€¢ å¿«é€Ÿå®šä½é—®é¢˜åŸå› 
â€¢ åˆ†ææ•°æ®è´¨é‡é—®é¢˜
â€¢ ä¼˜åŒ–çº¦æŸè®¾è®¡

å¼€å‘ä»·å€¼ï¼š
â€¢ è°ƒè¯•åº”ç”¨ç¨‹åºé”™è¯¯
â€¢ æ”¹è¿›æ•°æ®éªŒè¯é€»è¾‘
â€¢ å®Œå–„å¼‚å¸¸å¤„ç†æœºåˆ¶
```

---

## 3. ğŸ”§ å†²çªè¯Šæ–­ä¸é”™è¯¯ä»£ç åˆ†æ


### 3.1 å¸¸è§é”™è¯¯ä»£ç åˆ†æ


**ğŸ”¸ MySQLé”™è¯¯ä»£ç **

| é”™è¯¯ä»£ç  | é”™è¯¯ç±»å‹ | å«ä¹‰è§£é‡Š | å…¸å‹åœºæ™¯ |
|----------|----------|----------|----------|
| **1062** | `Duplicate entry` | ä¸»é”®æˆ–å”¯ä¸€é”®é‡å¤ | æ’å…¥å·²å­˜åœ¨çš„ç”¨æˆ·ID |
| **1452** | `Foreign key constraint fails` | å¤–é”®çº¦æŸè¿å | å¼•ç”¨ä¸å­˜åœ¨çš„éƒ¨é—¨ID |
| **1048** | `Column cannot be null` | éç©ºçº¦æŸè¿å | å¿…å¡«å­—æ®µä¸ºç©º |
| **1264** | `Out of range value` | æ•°å€¼è¶…å‡ºèŒƒå›´ | å¹´é¾„è¾“å…¥è´Ÿæ•° |
| **1406** | `Data too long` | æ•°æ®é•¿åº¦è¶…é™ | å§“åè¶…è¿‡æœ€å¤§å­—ç¬¦æ•° |

**ğŸ”¸ PostgreSQLé”™è¯¯ä»£ç **

| é”™è¯¯ä»£ç  | é”™è¯¯ç±»å‹ | å«ä¹‰è§£é‡Š | è§£å†³æ€è·¯ |
|----------|----------|----------|----------|
| **23505** | `unique_violation` | å”¯ä¸€æ€§çº¦æŸè¿å | æ£€æŸ¥æ•°æ®æ˜¯å¦é‡å¤ |
| **23503** | `foreign_key_violation` | å¤–é”®çº¦æŸè¿å | ç¡®è®¤å¼•ç”¨æ•°æ®å­˜åœ¨ |
| **23502** | `not_null_violation` | éç©ºçº¦æŸè¿å | æä¾›å¿…éœ€çš„å­—æ®µå€¼ |
| **23514** | `check_violation` | æ£€æŸ¥çº¦æŸè¿å | éªŒè¯æ•°æ®èŒƒå›´å’Œæ ¼å¼ |

### 3.2 å†²çªè¯Šæ–­æ–¹æ³•


**ğŸ”¸ ç³»ç»ŸåŒ–è¯Šæ–­æµç¨‹**
```
çº¦æŸå†²çªè¯Šæ–­æ­¥éª¤ï¼š

æ­¥éª¤1ï¼šé”™è¯¯ä¿¡æ¯åˆ†æ
    â†“
æ­¥éª¤2ï¼šå®šä½å…·ä½“çº¦æŸ
    â†“  
æ­¥éª¤3ï¼šåˆ†æå†²çªåŸå› 
    â†“
æ­¥éª¤4ï¼šè¯„ä¼°å½±å“èŒƒå›´
    â†“
æ­¥éª¤5ï¼šåˆ¶å®šè§£å†³æ–¹æ¡ˆ
```

**ğŸ”¸ è¯Šæ–­å®ä¾‹**
```sql
-- é”™è¯¯åœºæ™¯
INSERT INTO orders (id, customer_id, amount) 
VALUES (1001, 9999, 500.00);

-- é”™è¯¯ä¿¡æ¯
ERROR 1452: Cannot add foreign key constraint fails 
`shop`.`orders` CONSTRAINT `fk_customer` 
FOREIGN KEY (`customer_id`) REFERENCES `customers` (`id`)

-- è¯Šæ–­åˆ†æ
1. é”™è¯¯ç±»å‹ï¼šå¤–é”®çº¦æŸè¿å
2. æ¶‰åŠè¡¨ï¼šordersè¡¨å’Œcustomersè¡¨
3. é—®é¢˜å­—æ®µï¼šcustomer_id = 9999
4. æ ¹æœ¬åŸå› ï¼šcustomersè¡¨ä¸­ä¸å­˜åœ¨idä¸º9999çš„å®¢æˆ·
5. è§£å†³æ–¹æ¡ˆï¼š
   - æ–¹æ¡ˆAï¼šå…ˆåˆ›å»ºidä¸º9999çš„å®¢æˆ·
   - æ–¹æ¡ˆBï¼šä½¿ç”¨å­˜åœ¨çš„customer_id
   - æ–¹æ¡ˆCï¼šæ£€æŸ¥æ•°æ®æ¥æºï¼Œä¿®æ­£é”™è¯¯
```

### 3.3 å†²çªå½±å“è¯„ä¼°


**ğŸ”¸ å½±å“èŒƒå›´åˆ†æ**
```
å•æ¡è®°å½•å½±å“ï¼š
â€¢ å½“å‰æ“ä½œå¤±è´¥
â€¢ ç›¸å…³ä¸šåŠ¡æµç¨‹ä¸­æ–­
â€¢ ç”¨æˆ·ä½“éªŒå—å½±å“

æ‰¹é‡æ“ä½œå½±å“ï¼š
â€¢ æ•´ä¸ªæ‰¹é‡æ“ä½œå¯èƒ½å›æ»š
â€¢ å½±å“æ•°æ®å¯¼å…¥è¿›åº¦
â€¢ å¯èƒ½é€ æˆæ•°æ®ä¸ä¸€è‡´

å…³è”è¡¨å½±å“ï¼š
â€¢ å¤–é”®å…³è”çš„å…¶ä»–è¡¨æ“ä½œå—é™
â€¢ çº§è”æ“ä½œå¯èƒ½è¢«é˜»æ­¢
â€¢ æ•°æ®å®Œæ•´æ€§é£é™©
```

---

## 4. ğŸ”„ çº¦æŸå†²çªå¤„ç†æµç¨‹


### 4.1 æ ‡å‡†å¤„ç†æµç¨‹


**ğŸ”‘ çº¦æŸå†²çªå¤„ç†æµç¨‹**
```
å†²çªæ£€æµ‹
    â†“
è®°å½•æ—¥å¿—
    â†“
åˆ†æå†²çªç±»å‹
    â†“
è¯„ä¼°å¤„ç†ç­–ç•¥
    â†“
æ‰§è¡Œä¿®å¤æ“ä½œ
    â†“
éªŒè¯ä¿®å¤ç»“æœ
    â†“
æ›´æ–°ç›‘æ§ç»Ÿè®¡
```

**ğŸ”¸ å¤„ç†æµç¨‹è¯¦è§£**
```sql
-- æµç¨‹å®ç°ç¤ºä¾‹
BEGIN TRANSACTION;

-- 1. å°è¯•æ‰§è¡Œæ“ä½œ
INSERT INTO students (id, name, email) 
VALUES ('001', 'å¼ ä¸‰', 'zhangsan@email.com');

-- 2. æ•è·çº¦æŸå†²çª
EXCEPTION
    WHEN unique_violation THEN
        -- 3. è®°å½•å†²çªæ—¥å¿—
        INSERT INTO constraint_violation_log (
            table_name, constraint_name, error_message, 
            violation_time, attempted_values
        ) VALUES (
            'students', 'uk_email', 'Email already exists',
            NOW(), 'zhangsan@email.com'
        );
        
        -- 4. æ ¹æ®ç­–ç•¥å¤„ç†
        IF conflict_strategy = 'UPDATE' THEN
            UPDATE students SET name = 'å¼ ä¸‰' 
            WHERE email = 'zhangsan@email.com';
        ELSIF conflict_strategy = 'IGNORE' THEN
            -- å¿½ç•¥å†²çªï¼Œç»§ç»­æ‰§è¡Œ
            NULL;
        ELSE
            -- æŠ›å‡ºé”™è¯¯ï¼Œç”±åº”ç”¨ç¨‹åºå¤„ç†
            RAISE EXCEPTION 'Constraint violation detected';
        END IF;

COMMIT;
```

### 4.2 å¼‚å¸¸å¤„ç†æµç¨‹


**ğŸ”¸ åº”ç”¨ç¨‹åºå¼‚å¸¸å¤„ç†**
```java
public class ConstraintHandler {
    
    public boolean saveStudent(Student student) {
        try {
            // å°è¯•ä¿å­˜å­¦ç”Ÿä¿¡æ¯
            studentRepository.save(student);
            return true;
            
        } catch (DataIntegrityViolationException ex) {
            // æ•è·çº¦æŸå†²çªå¼‚å¸¸
            return handleConstraintViolation(ex, student);
        }
    }
    
    private boolean handleConstraintViolation(
        DataIntegrityViolationException ex, Student student) {
        
        // 1. åˆ†æé”™è¯¯ç±»å‹
        ConstraintType type = analyzeConstraintType(ex);
        
        // 2. è®°å½•å†²çªæ—¥å¿—
        logConstraintViolation(type, student, ex.getMessage());
        
        // 3. æ ¹æ®ç±»å‹æ‰§è¡Œç›¸åº”ç­–ç•¥
        switch (type) {
            case PRIMARY_KEY_DUPLICATE:
                return handlePrimaryKeyConflict(student);
            case FOREIGN_KEY_VIOLATION:
                return handleForeignKeyConflict(student);
            case UNIQUE_CONSTRAINT:
                return handleUniqueConstraintConflict(student);
            default:
                return false;
        }
    }
}
```

### 4.3 å¤„ç†ç­–ç•¥é€‰æ‹©


**ğŸ”¸ å¸¸è§å¤„ç†ç­–ç•¥å¯¹æ¯”**

| ç­–ç•¥ç±»å‹ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ä½¿ç”¨å»ºè®® |
|----------|----------|------|------|----------|
| **ç«‹å³å¤±è´¥** | ä¸¥æ ¼çš„ä¸šåŠ¡åœºæ™¯ | ä¿è¯æ•°æ®å‡†ç¡®æ€§ | ç”¨æˆ·ä½“éªŒå·® | é‡‘èã€åŒ»ç–—ç­‰å…³é”®ä¸šåŠ¡ |
| **è‡ªåŠ¨ä¿®å¤** | æ•°æ®å¯¼å…¥ã€åŒæ­¥ | å‡å°‘äººå·¥å¹²é¢„ | å¯èƒ½æ©ç›–é—®é¢˜ | éå…³é”®æ•°æ®æ‰¹é‡å¤„ç† |
| **å¿½ç•¥å†²çª** | å¹‚ç­‰æ“ä½œ | æ“ä½œç®€å• | å¯èƒ½ä¸¢å¤±ä¿¡æ¯ | æ—¥å¿—è®°å½•ã€ç»Ÿè®¡åˆ†æ |
| **å»¶è¿Ÿå¤„ç†** | é«˜å¹¶å‘åœºæ™¯ | ä¸é˜»å¡æ­£å¸¸æµç¨‹ | å¢åŠ ç³»ç»Ÿå¤æ‚æ€§ | æ¶ˆæ¯é˜Ÿåˆ—ã€å¼‚æ­¥å¤„ç† |

---

## 5. ğŸ› ï¸ æ•°æ®ä¿®å¤ç­–ç•¥ä¸è§£å†³æ–¹æ¡ˆ


### 5.1 ä¸»é”®å†²çªä¿®å¤æ–¹æ¡ˆ


**ğŸ”¸ ä¸»é”®å†²çªçš„å¤„ç†ç­–ç•¥**
```sql
-- ç­–ç•¥1ï¼šæ›´æ–°ç°æœ‰è®°å½•
INSERT INTO students (id, name, email) 
VALUES ('001', 'å¼ ä¸‰', 'new@email.com')
ON DUPLICATE KEY UPDATE 
    name = VALUES(name),
    email = VALUES(email),
    updated_at = NOW();

-- ç­–ç•¥2ï¼šç”Ÿæˆæ–°çš„ä¸»é”®
INSERT INTO students (id, name, email) 
SELECT 
    CONCAT('STU_', UNIX_TIMESTAMP(), '_', RAND()),
    'å¼ ä¸‰',
    'zhangsan@email.com'
WHERE NOT EXISTS (
    SELECT 1 FROM students WHERE id = '001'
);

-- ç­–ç•¥3ï¼šæ¡ä»¶æ’å…¥ï¼ˆå¿½ç•¥å†²çªï¼‰
INSERT IGNORE INTO students (id, name, email) 
VALUES ('001', 'å¼ ä¸‰', 'zhangsan@email.com');
```

### 5.2 å¤–é”®å†²çªä¿®å¤æ–¹æ¡ˆ


**ğŸ”¸ å¤–é”®å†²çªå¤„ç†æ–¹æ³•**
```sql
-- é—®é¢˜ï¼šæ’å…¥è®¢å•æ—¶å®¢æˆ·ä¸å­˜åœ¨
INSERT INTO orders (id, customer_id, amount) 
VALUES (1001, 9999, 500.00);  -- customer_id 9999ä¸å­˜åœ¨

-- è§£å†³æ–¹æ¡ˆ1ï¼šå…ˆåˆ›å»ºç¼ºå¤±çš„å®¢æˆ·
INSERT IGNORE INTO customers (id, name, email) 
VALUES (9999, 'ä¸´æ—¶å®¢æˆ·', 'temp@email.com');

INSERT INTO orders (id, customer_id, amount) 
VALUES (1001, 9999, 500.00);

-- è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨é»˜è®¤å®¢æˆ·
UPDATE orders_temp SET customer_id = 1  -- é»˜è®¤å®¢æˆ·ID
WHERE customer_id NOT IN (SELECT id FROM customers);

-- è§£å†³æ–¹æ¡ˆ3ï¼šåˆ›å»ºä¿®å¤å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE FixForeignKeyViolations()
BEGIN
    -- è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„å¼•ç”¨æ•°æ®
    INSERT IGNORE INTO customers (id, name, email)
    SELECT DISTINCT customer_id, 
           CONCAT('Customer_', customer_id), 
           CONCAT('temp_', customer_id, '@temp.com')
    FROM orders 
    WHERE customer_id NOT IN (SELECT id FROM customers);
END $$
```

### 5.3 æ•°æ®è´¨é‡æ£€æŸ¥å·¥å…·


**ğŸ”¸ çº¦æŸéªŒè¯æŸ¥è¯¢**
```sql
-- æ£€æŸ¥ä¸»é”®é‡å¤
SELECT id, COUNT(*) as duplicate_count
FROM students 
GROUP BY id 
HAVING COUNT(*) > 1;

-- æ£€æŸ¥å¤–é”®å­¤å„¿è®°å½•
SELECT o.id, o.customer_id
FROM orders o
LEFT JOIN customers c ON o.customer_id = c.id
WHERE c.id IS NULL;

-- æ£€æŸ¥å”¯ä¸€æ€§çº¦æŸè¿å
SELECT email, COUNT(*) as duplicate_count
FROM students 
WHERE email IS NOT NULL
GROUP BY email 
HAVING COUNT(*) > 1;

-- æ£€æŸ¥æ•°æ®èŒƒå›´çº¦æŸ
SELECT id, age 
FROM students 
WHERE age < 0 OR age > 120;
```

**ğŸ”¸ æ•°æ®è´¨é‡æŠ¥å‘Šç”Ÿæˆ**
```sql
-- ç»¼åˆæ•°æ®è´¨é‡æ£€æŸ¥
CREATE VIEW data_quality_report AS
SELECT 
    'students' as table_name,
    'primary_key' as constraint_type,
    COUNT(*) as violation_count
FROM (
    SELECT id FROM students GROUP BY id HAVING COUNT(*) > 1
) pk_violations

UNION ALL

SELECT 
    'orders' as table_name,
    'foreign_key' as constraint_type,
    COUNT(*) as violation_count
FROM orders o
LEFT JOIN customers c ON o.customer_id = c.id
WHERE c.id IS NULL;
```

---

## 6. ğŸ¤– çº¦æŸå†²çªè‡ªåŠ¨ä¿®å¤æœºåˆ¶


### 6.1 è‡ªåŠ¨ä¿®å¤çš„åŸºæœ¬åŸç†


**ğŸ”¥ çº¦æŸå†²çªè‡ªåŠ¨ä¿®å¤**
è‡ªåŠ¨ä¿®å¤æ˜¯æŒ‡**ç³»ç»Ÿæ£€æµ‹åˆ°çº¦æŸå†²çªæ—¶ï¼Œæ ¹æ®é¢„è®¾è§„åˆ™è‡ªåŠ¨å¤„ç†**ï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼š

```
è‡ªåŠ¨ä¿®å¤çš„å·¥ä½œæµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æµ‹å†²çª     â”‚ â†’ â”‚ åŒ¹é…ä¿®å¤è§„åˆ™ â”‚ â†’ â”‚ æ‰§è¡Œä¿®å¤æ“ä½œ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                   â†“                   â†“
   è¯†åˆ«å†²çªç±»å‹        æŸ¥æ‰¾å¤„ç†ç­–ç•¥        è‡ªåŠ¨è§£å†³å†²çª

æˆåŠŸæ¡ˆä¾‹ï¼š
â€¢ ä¸»é”®å†²çª â†’ è‡ªåŠ¨ç”Ÿæˆæ–°ä¸»é”®
â€¢ å¤–é”®å†²çª â†’ è‡ªåŠ¨åˆ›å»ºé»˜è®¤å¼•ç”¨æ•°æ®  
â€¢ æ ¼å¼é”™è¯¯ â†’ è‡ªåŠ¨æ•°æ®æ¸…æ´—è½¬æ¢
```

### 6.2 è‡ªåŠ¨ä¿®å¤è§„åˆ™é…ç½®


**ğŸ”¸ ä¿®å¤è§„åˆ™å®šä¹‰**
```sql
-- åˆ›å»ºçº¦æŸä¿®å¤è§„åˆ™è¡¨
CREATE TABLE constraint_repair_rules (
    id INT PRIMARY KEY AUTO_INCREMENT,
    table_name VARCHAR(100),
    constraint_type ENUM('PRIMARY_KEY', 'FOREIGN_KEY', 'UNIQUE', 'CHECK'),
    constraint_name VARCHAR(100),
    repair_strategy ENUM('AUTO_FIX', 'NOTIFY', 'IGNORE', 'DEFER'),
    repair_action TEXT,  -- å…·ä½“çš„ä¿®å¤SQLæˆ–é€»è¾‘
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- é…ç½®ä¿®å¤è§„åˆ™ç¤ºä¾‹
INSERT INTO constraint_repair_rules VALUES
(1, 'students', 'PRIMARY_KEY', 'pk_student_id', 'AUTO_FIX', 
 'Generate new ID with prefix STU_'),
(2, 'orders', 'FOREIGN_KEY', 'fk_customer_id', 'AUTO_FIX',
 'Create default customer record'),
(3, 'products', 'UNIQUE', 'uk_product_code', 'NOTIFY',
 'Send alert to admin for manual review');
```

### 6.3 æ™ºèƒ½ä¿®å¤ç®—æ³•


**ğŸ”¸ è‡ªé€‚åº”ä¿®å¤ç­–ç•¥**
```java
public class IntelligentConstraintFixer {
    
    public RepairResult autoRepair(ConstraintViolation violation) {
        // 1. åˆ†æå†²çªæ¨¡å¼
        ConflictPattern pattern = analyzePattern(violation);
        
        // 2. é€‰æ‹©æœ€ä½³ä¿®å¤ç­–ç•¥
        RepairStrategy strategy = selectOptimalStrategy(pattern);
        
        // 3. æ‰§è¡Œä¿®å¤æ“ä½œ
        return executeRepair(violation, strategy);
    }
    
    private ConflictPattern analyzePattern(ConstraintViolation violation) {
        return ConflictPattern.builder()
            .constraintType(violation.getType())
            .frequency(getViolationFrequency(violation))
            .dataSource(violation.getDataSource())
            .businessCriticality(assessCriticality(violation))
            .build();
    }
    
    private RepairStrategy selectOptimalStrategy(ConflictPattern pattern) {
        // åŸºäºå†å²æˆåŠŸç‡å’Œä¸šåŠ¡å½±å“é€‰æ‹©ç­–ç•¥
        if (pattern.getCriticality() == BusinessCriticality.HIGH) {
            return RepairStrategy.MANUAL_REVIEW;
        } else if (pattern.getFrequency() > 10) {
            return RepairStrategy.BATCH_AUTO_FIX;
        } else {
            return RepairStrategy.IMMEDIATE_AUTO_FIX;
        }
    }
}
```

### 6.4 ä¿®å¤æˆåŠŸç‡ç›‘æ§


**ğŸ”¸ ä¿®å¤æ•ˆæœè·Ÿè¸ª**
```sql
-- ä¿®å¤æ“ä½œè®°å½•è¡¨
CREATE TABLE constraint_repair_log (
    id INT PRIMARY KEY AUTO_INCREMENT,
    violation_id INT,
    repair_strategy VARCHAR(50),
    repair_result ENUM('SUCCESS', 'FAILED', 'PARTIAL'),
    before_state TEXT,
    after_state TEXT,
    repair_time TIMESTAMP,
    manual_review_required BOOLEAN DEFAULT FALSE
);

-- ä¿®å¤æˆåŠŸç‡ç»Ÿè®¡
SELECT 
    constraint_type,
    repair_strategy,
    COUNT(*) as total_attempts,
    SUM(CASE WHEN repair_result = 'SUCCESS' THEN 1 ELSE 0 END) as success_count,
    ROUND(
        SUM(CASE WHEN repair_result = 'SUCCESS' THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 
        2
    ) as success_rate
FROM constraint_repair_log 
GROUP BY constraint_type, repair_strategy;
```

---

## 7. ğŸ“Š ç›‘æ§é€šçŸ¥ä¸é¢„é˜²æœºåˆ¶


### 7.1 çº¦æŸè¿åç»Ÿè®¡ç›‘æ§


**ğŸ”¥ çº¦æŸè¿åç»Ÿè®¡ç›‘æ§**
å»ºç«‹**å®æ—¶ç›‘æ§ä½“ç³»**ï¼Œè¿½è¸ªçº¦æŸå†²çªçš„è¶‹åŠ¿å’Œæ¨¡å¼ï¼š

```sql
-- åˆ›å»ºç›‘æ§ç»Ÿè®¡è¡¨
CREATE TABLE constraint_violation_stats (
    id INT PRIMARY KEY AUTO_INCREMENT,
    date DATE,
    table_name VARCHAR(100),
    constraint_type VARCHAR(50),
    violation_count INT,
    auto_fixed_count INT,
    manual_fixed_count INT,
    unresolved_count INT,
    avg_resolution_time DECIMAL(10,2), -- å¹³å‡è§£å†³æ—¶é—´(åˆ†é’Ÿ)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ¯æ—¥ç»Ÿè®¡æ›´æ–°
INSERT INTO constraint_violation_stats (
    date, table_name, constraint_type, violation_count,
    auto_fixed_count, manual_fixed_count, unresolved_count
)
SELECT 
    DATE(violation_time) as date,
    table_name,
    constraint_type,
    COUNT(*) as violation_count,
    SUM(CASE WHEN repair_result = 'AUTO_SUCCESS' THEN 1 ELSE 0 END),
    SUM(CASE WHEN repair_result = 'MANUAL_SUCCESS' THEN 1 ELSE 0 END),
    SUM(CASE WHEN repair_result IS NULL THEN 1 ELSE 0 END)
FROM constraint_violation_log 
WHERE DATE(violation_time) = CURDATE()
GROUP BY DATE(violation_time), table_name, constraint_type;
```

### 7.2 çº¦æŸå†²çªé€šçŸ¥æœºåˆ¶


**ğŸ”¥ çº¦æŸå†²çªé€šçŸ¥æœºåˆ¶**
å½“çº¦æŸå†²çªè¾¾åˆ°**é¢„è®¾é˜ˆå€¼**æ—¶ï¼Œè‡ªåŠ¨é€šçŸ¥ç›¸å…³äººå‘˜ï¼š

```java
public class ConstraintViolationNotifier {
    
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void checkViolationThreshold() {
        List<ViolationStats> stats = getRecentViolationStats();
        
        for (ViolationStats stat : stats) {
            // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼
            if (stat.getViolationCount() > getThreshold(stat.getTableName())) {
                sendAlert(stat);
            }
            
            // æ£€æŸ¥è‡ªåŠ¨ä¿®å¤å¤±è´¥ç‡
            if (stat.getAutoFixFailureRate() > 0.3) {
                sendCriticalAlert(stat);
            }
        }
    }
    
    private void sendAlert(ViolationStats stat) {
        AlertMessage message = AlertMessage.builder()
            .level(AlertLevel.WARNING)
            .title("çº¦æŸå†²çªé¢‘ç‡å‘Šè­¦")
            .content(String.format(
                "è¡¨ %s åœ¨è¿‡å»5åˆ†é’Ÿå†…å‘ç”Ÿ %d æ¬¡çº¦æŸå†²çªï¼Œ" +
                "è¶…è¿‡é˜ˆå€¼ %dï¼Œè¯·å…³æ³¨æ•°æ®è´¨é‡",
                stat.getTableName(), 
                stat.getViolationCount(),
                getThreshold(stat.getTableName())
            ))
            .recipients(getTableOwners(stat.getTableName()))
            .build();
            
        notificationService.send(message);
    }
}
```

**ğŸ”¸ é€šçŸ¥æ¸ é“é…ç½®**
```
é€šçŸ¥æ–¹å¼ï¼š
ğŸ“§ é‚®ä»¶é€šçŸ¥ï¼šè¯¦ç»†çš„å†²çªæŠ¥å‘Š
ğŸ“± çŸ­ä¿¡å‘Šè­¦ï¼šç´§æ€¥æƒ…å†µå³æ—¶é€šçŸ¥  
ğŸ”” ç³»ç»Ÿæ¶ˆæ¯ï¼šç®¡ç†åå°æé†’
ğŸ“Š ç›‘æ§çœ‹æ¿ï¼šå¯è§†åŒ–è¿è§„è¶‹åŠ¿
ğŸ¤– è‡ªåŠ¨å·¥å•ï¼šä¸¥é‡å†²çªè‡ªåŠ¨åˆ›å»ºå¤„ç†å·¥å•
```

### 7.3 å†²çªé¢„é˜²æœºåˆ¶


**ğŸ”¸ é¢„é˜²æ€§æ£€æŸ¥**
```sql
-- æ•°æ®æ’å…¥å‰çš„é¢„æ£€æŸ¥
CREATE PROCEDURE PreValidateData(
    IN p_table_name VARCHAR(100),
    IN p_data JSON
)
BEGIN
    DECLARE v_constraint_violations INT DEFAULT 0;
    
    -- æ£€æŸ¥ä¸»é”®æ˜¯å¦å·²å­˜åœ¨
    IF p_table_name = 'students' THEN
        SELECT COUNT(*) INTO v_constraint_violations
        FROM students 
        WHERE id = JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.id'));
        
        IF v_constraint_violations > 0 THEN
            SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'ä¸»é”®å·²å­˜åœ¨ï¼Œå»ºè®®ä½¿ç”¨UPDATEæ“ä½œ';
        END IF;
    END IF;
    
    -- æ£€æŸ¥å¿…éœ€çš„å¤–é”®å¼•ç”¨æ˜¯å¦å­˜åœ¨
    -- ... å…¶ä»–é¢„æ£€æŸ¥é€»è¾‘
END;
```

**ğŸ”¸ æ•°æ®è´¨é‡é—¨æ§**
```java
public class DataQualityGate {
    
    // æ‰¹é‡æ•°æ®æ’å…¥å‰çš„è´¨é‡æ£€æŸ¥
    public ValidationResult validateBatchData(List<Map<String, Object>> dataList) {
        ValidationResult result = new ValidationResult();
        
        // 1. é‡å¤æ€§æ£€æŸ¥
        Set<Object> primaryKeys = new HashSet<>();
        for (Map<String, Object> data : dataList) {
            Object pk = data.get("id");
            if (primaryKeys.contains(pk)) {
                result.addError("æ‰¹é‡æ•°æ®ä¸­å­˜åœ¨é‡å¤ä¸»é”®: " + pk);
            }
            primaryKeys.add(pk);
        }
        
        // 2. å¤–é”®å¼•ç”¨æ£€æŸ¥
        validateForeignKeyReferences(dataList, result);
        
        // 3. æ•°æ®æ ¼å¼æ£€æŸ¥
        validateDataFormats(dataList, result);
        
        return result;
    }
    
    // åªæœ‰é€šè¿‡è´¨é‡é—¨æ§æ‰å…è®¸æ‰§è¡Œ
    public boolean executeBatchInsert(List<Map<String, Object>> dataList) {
        ValidationResult validation = validateBatchData(dataList);
        
        if (!validation.isValid()) {
            logValidationErrors(validation);
            return false;
        }
        
        return performBatchInsert(dataList);
    }
}
```

---

## 8. ğŸ“¦ æ‰¹é‡æ•°æ®çº¦æŸå¤„ç†


### 8.1 æ‰¹é‡æ•°æ®çº¦æŸå¤„ç†æŒ‘æˆ˜


**ğŸ”¸ æ‰¹é‡æ“ä½œçš„ç‰¹æ®Šæ€§**
```
æ‰¹é‡æ“ä½œç‰¹ç‚¹ï¼š
â€¢ æ•°æ®é‡å¤§ï¼šå‡ åƒåˆ°å‡ ç™¾ä¸‡æ¡è®°å½•
â€¢ å†²çªå¤æ‚ï¼šå¤šç§çº¦æŸå¯èƒ½åŒæ—¶è¿å
â€¢ å¤„ç†è¦æ±‚ï¼šæ—¢è¦ä¿è¯æ•°æ®å®Œæ•´æ€§ï¼Œåˆè¦æé«˜å¤„ç†æ•ˆç‡

å¸¸è§é—®é¢˜ï¼š
âŒ å•æ¡è®°å½•å†²çªå¯¼è‡´æ•´ä¸ªæ‰¹é‡æ“ä½œå¤±è´¥
âŒ é€æ¡æ£€æŸ¥æ€§èƒ½å¤ªæ…¢
âŒ é”™è¯¯ä¿¡æ¯ä¸æ˜ç¡®ï¼Œéš¾ä»¥å®šä½é—®é¢˜
```

### 8.2 æ‰¹é‡å¤„ç†ç­–ç•¥


**ğŸ”¸ åˆ†æ‰¹å¤„ç†ç­–ç•¥**
```sql
-- åˆ†æ‰¹æ’å…¥ï¼Œå‡å°‘é”å®šæ—¶é—´å’Œå†²çªå½±å“
DELIMITER $$
CREATE PROCEDURE BatchInsertWithConflictHandling(
    IN batch_size INT DEFAULT 1000
)
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE current_batch INT DEFAULT 0;
    
    -- åˆ†æ‰¹å¤„ç†ä¸´æ—¶è¡¨ä¸­çš„æ•°æ®
    WHILE (SELECT COUNT(*) FROM temp_students_import) > 0 DO
        BEGIN
            -- å£°æ˜å¼‚å¸¸å¤„ç†
            DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
            BEGIN
                -- è®°å½•æ‰¹æ¬¡å¤±è´¥
                INSERT INTO batch_error_log (batch_id, error_message) 
                VALUES (current_batch, 'Constraint violation in batch');
                ROLLBACK;
            END;
            
            START TRANSACTION;
            
            -- å¤„ç†å½“å‰æ‰¹æ¬¡
            INSERT INTO students (id, name, email)
            SELECT id, name, email 
            FROM temp_students_import 
            LIMIT batch_size
            ON DUPLICATE KEY UPDATE 
                name = VALUES(name),
                updated_at = NOW();
            
            -- åˆ é™¤å·²å¤„ç†çš„æ•°æ®
            DELETE FROM temp_students_import LIMIT batch_size;
            
            COMMIT;
            SET current_batch = current_batch + 1;
        END;
    END WHILE;
END $$
```

**ğŸ”¸ é”™è¯¯éš”ç¦»ç­–ç•¥**
```java
public class BatchConstraintProcessor {
    
    public BatchProcessResult processBatch(List<StudentData> students) {
        BatchProcessResult result = new BatchProcessResult();
        List<StudentData> problematicRecords = new ArrayList<>();
        
        // 1. å…ˆå¤„ç†æ˜æ˜¾æ— å†²çªçš„æ•°æ®
        List<StudentData> cleanData = prefilterCleanData(students);
        int successCount = bulkInsert(cleanData);
        result.setSuccessCount(successCount);
        
        // 2. é€ä¸ªå¤„ç†å¯èƒ½æœ‰å†²çªçš„æ•°æ®
        List<StudentData> conflictData = students.removeAll(cleanData);
        for (StudentData student : conflictData) {
            try {
                insertWithConflictHandling(student);
                result.incrementSuccess();
            } catch (ConstraintViolationException ex) {
                problematicRecords.add(student);
                result.addError(student.getId(), ex.getMessage());
            }
        }
        
        // 3. ç”Ÿæˆé—®é¢˜æ•°æ®æŠ¥å‘Š
        if (!problematicRecords.isEmpty()) {
            generateErrorReport(problematicRecords);
        }
        
        return result;
    }
    
    private List<StudentData> prefilterCleanData(List<StudentData> students) {
        // å¿«é€Ÿæ£€æŸ¥ï¼šå»é™¤æ˜æ˜¾ä¼šå†²çªçš„æ•°æ®
        Set<String> existingIds = getExistingStudentIds();
        return students.stream()
            .filter(s -> !existingIds.contains(s.getId()))
            .filter(s -> isDataFormatValid(s))
            .collect(Collectors.toList());
    }
}
```

### 8.3 æ‰¹é‡æ•°æ®ä¿®å¤å·¥å…·


**ğŸ”¸ æ•°æ®æ¸…æ´—ä¸ä¿®å¤å·¥å…·**
```sql
-- æ‰¹é‡æ•°æ®ä¿®å¤å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE BatchDataRepair()
BEGIN
    DECLARE repair_count INT DEFAULT 0;
    
    -- 1. ä¿®å¤ä¸»é”®å†²çªï¼šä¸ºé‡å¤ä¸»é”®ç”Ÿæˆæ–°å€¼
    UPDATE students_import si
    SET id = CONCAT('STU_', UNIX_TIMESTAMP(), '_', RAND())
    WHERE id IN (
        SELECT original_id FROM (
            SELECT id as original_id, COUNT(*) 
            FROM students_import 
            GROUP BY id HAVING COUNT(*) > 1
        ) duplicates
    ) AND id IN (SELECT id FROM students);
    
    GET DIAGNOSTICS repair_count = ROW_COUNT;
    INSERT INTO repair_log VALUES ('ä¸»é”®å†²çªä¿®å¤', repair_count, NOW());
    
    -- 2. ä¿®å¤å¤–é”®å†²çªï¼šåˆ›å»ºç¼ºå¤±çš„å¼•ç”¨æ•°æ®
    INSERT IGNORE INTO departments (id, name)
    SELECT DISTINCT department_id, CONCAT('éƒ¨é—¨_', department_id)
    FROM students_import si
    WHERE department_id NOT IN (SELECT id FROM departments);
    
    GET DIAGNOSTICS repair_count = ROW_COUNT;
    INSERT INTO repair_log VALUES ('å¤–é”®å†²çªä¿®å¤', repair_count, NOW());
    
    -- 3. ä¿®å¤æ•°æ®æ ¼å¼é—®é¢˜
    UPDATE students_import 
    SET email = LOWER(TRIM(email))
    WHERE email REGEXP '^[A-Z]' OR email LIKE ' %' OR email LIKE '% ';
    
    GET DIAGNOSTICS repair_count = ROW_COUNT;
    INSERT INTO repair_log VALUES ('æ•°æ®æ ¼å¼ä¿®å¤', repair_count, NOW());
    
END $$
```

---

## 7. ğŸ“ˆ ç›‘æ§é€šçŸ¥ä¸é¢„é˜²æœºåˆ¶


### 7.1 å®æ—¶ç›‘æ§ç³»ç»Ÿ


**ğŸ”¸ çº¦æŸè¿åå®æ—¶ç›‘æ§**
```java
@Component
public class ConstraintViolationMonitor {
    
    private final MetricRegistry metrics = new MetricRegistry();
    
    @EventListener
    public void handleConstraintViolation(ConstraintViolationEvent event) {
        // 1. æ›´æ–°è¿è§„è®¡æ•°å™¨
        String metricName = String.format("constraint.violation.%s.%s", 
            event.getTableName(), event.getConstraintType());
        metrics.counter(metricName).inc();
        
        // 2. æ£€æŸ¥æ˜¯å¦éœ€è¦å‘Šè­¦
        if (shouldTriggerAlert(event)) {
            triggerAlert(event);
        }
        
        // 3. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateViolationStatistics(event);
    }
    
    private boolean shouldTriggerAlert(ConstraintViolationEvent event) {
        // åŸºäºé¢‘ç‡å’Œä¸¥é‡ç¨‹åº¦åˆ¤æ–­
        long recentCount = getRecentViolationCount(
            event.getTableName(), Duration.ofMinutes(5)
        );
        
        return recentCount > getAlertThreshold(event.getTableName());
    }
}
```

### 7.2 é¢„è­¦æœºåˆ¶


**ğŸ”¸ åˆ†çº§é¢„è­¦ç³»ç»Ÿ**
```
é¢„è­¦çº§åˆ«åˆ†ç±»ï¼š
ğŸŸ¢ ä¿¡æ¯çº§ï¼šå¶å‘å†²çªï¼Œæ­£å¸¸è®°å½•
ğŸŸ¡ è­¦å‘Šçº§ï¼šå†²çªé¢‘ç‡ä¸Šå‡ï¼Œéœ€è¦å…³æ³¨
ğŸŸ  ç´§æ€¥çº§ï¼šå¤§é‡å†²çªï¼Œå¯èƒ½å½±å“ä¸šåŠ¡
ğŸ”´ ä¸¥é‡çº§ï¼šç³»ç»Ÿæ€§é—®é¢˜ï¼Œéœ€è¦ç«‹å³å¤„ç†

é¢„è­¦è§¦å‘æ¡ä»¶ï¼š
â€¢ 5åˆ†é’Ÿå†…åŒä¸€ç±»å‹å†²çªè¶…è¿‡100æ¬¡ â†’ ğŸŸ¡è­¦å‘Š
â€¢ è‡ªåŠ¨ä¿®å¤æˆåŠŸç‡ä½äº70% â†’ ğŸŸ ç´§æ€¥
â€¢ å…³é”®ä¸šåŠ¡è¡¨è¿ç»­å†²çª â†’ ğŸ”´ä¸¥é‡
```

**ğŸ”¸ æ™ºèƒ½é¢„è­¦ç®—æ³•**
```java
public class IntelligentAlertSystem {
    
    public void evaluateViolationPattern(ViolationStatistics stats) {
        // 1. è¶‹åŠ¿åˆ†æ
        Trend trend = analyzeTrend(stats.getHistoricalData());
        
        // 2. å¼‚å¸¸æ£€æµ‹
        boolean isAnomaly = detectAnomaly(stats.getCurrentRate(), 
                                         stats.getHistoricalAverage());
        
        // 3. ä¸šåŠ¡å½±å“è¯„ä¼°
        BusinessImpact impact = assessBusinessImpact(stats.getTableName());
        
        // 4. ç»¼åˆå†³ç­–
        if (trend == Trend.RAPIDLY_INCREASING && impact == BusinessImpact.HIGH) {
            sendCriticalAlert(stats);
        } else if (isAnomaly && impact == BusinessImpact.MEDIUM) {
            sendWarningAlert(stats);
        }
    }
    
    private boolean detectAnomaly(double currentRate, double historicalAvg) {
        // ä½¿ç”¨3ÏƒåŸåˆ™æ£€æµ‹å¼‚å¸¸
        double threshold = historicalAvg + 3 * getStandardDeviation();
        return currentRate > threshold;
    }
}
```

### 7.3 é¢„é˜²æœºåˆ¶


**ğŸ”¸ æ•°æ®è¾“å…¥éªŒè¯**
```javascript
// å‰ç«¯æ•°æ®éªŒè¯
class DataValidator {
    
    static validateStudentData(studentData) {
        const errors = [];
        
        // 1. åŸºæœ¬æ ¼å¼æ£€æŸ¥
        if (!studentData.id || !/^STU\d{6}$/.test(studentData.id)) {
            errors.push('å­¦å·æ ¼å¼é”™è¯¯ï¼Œåº”ä¸ºSTU+6ä½æ•°å­—');
        }
        
        if (!studentData.email || !this.isValidEmail(studentData.email)) {
            errors.push('é‚®ç®±æ ¼å¼é”™è¯¯');
        }
        
        // 2. ä¸šåŠ¡è§„åˆ™æ£€æŸ¥
        if (studentData.age < 16 || studentData.age > 65) {
            errors.push('å¹´é¾„åº”åœ¨16-65å²ä¹‹é—´');
        }
        
        // 3. å¼‚æ­¥æ£€æŸ¥å”¯ä¸€æ€§ï¼ˆé¿å…é‡å¤æäº¤ï¼‰
        this.checkUniquenessAsync(studentData.id, studentData.email)
            .then(result => {
                if (!result.isUnique) {
                    errors.push(`${result.conflictField}å·²å­˜åœ¨`);
                }
            });
        
        return {
            isValid: errors.length === 0,
            errors: errors
        };
    }
    
    static isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
}
```

---

## 8. ğŸ“Š æ•°æ®è´¨é‡ç®¡ç†ä½“ç³»


### 8.1 æ•°æ®è´¨é‡æ£€æŸ¥å·¥å…·


**ğŸ”¥ æ•°æ®è´¨é‡æ£€æŸ¥å·¥å…·**
å»ºç«‹**ç³»ç»ŸåŒ–çš„æ•°æ®è´¨é‡æ£€æŸ¥ä½“ç³»**ï¼Œä¸»åŠ¨å‘ç°æ½œåœ¨é—®é¢˜ï¼š

```sql
-- æ•°æ®è´¨é‡æ£€æŸ¥è§„åˆ™é…ç½®è¡¨
CREATE TABLE data_quality_rules (
    id INT PRIMARY KEY AUTO_INCREMENT,
    rule_name VARCHAR(100),
    table_name VARCHAR(100),
    rule_type ENUM('COMPLETENESS', 'UNIQUENESS', 'VALIDITY', 'CONSISTENCY'),
    check_sql TEXT,
    threshold_value DECIMAL(5,2),
    severity ENUM('LOW', 'MEDIUM', 'HIGH', 'CRITICAL'),
    is_active BOOLEAN DEFAULT TRUE
);

-- é…ç½®è´¨é‡æ£€æŸ¥è§„åˆ™
INSERT INTO data_quality_rules (rule_name, table_name, rule_type, check_sql, threshold_value, severity) VALUES
('å­¦ç”Ÿé‚®ç®±å®Œæ•´æ€§', 'students', 'COMPLETENESS', 
 'SELECT (COUNT(*) - COUNT(email)) * 100.0 / COUNT(*) FROM students', 
 5.0, 'MEDIUM'),
('å­¦ç”ŸIDå”¯ä¸€æ€§', 'students', 'UNIQUENESS',
 'SELECT COUNT(*) FROM (SELECT id FROM students GROUP BY id HAVING COUNT(*) > 1) t',
 0, 'CRITICAL'),
('é‚®ç®±æ ¼å¼æœ‰æ•ˆæ€§', 'students', 'VALIDITY',
 'SELECT COUNT(*) FROM students WHERE email NOT REGEXP "^[^@]+@[^@]+\.[^@]+$"',
 0, 'HIGH');
```

**ğŸ”¸ è‡ªåŠ¨åŒ–è´¨é‡æ£€æŸ¥**
```java
@Service
public class DataQualityChecker {
    
    @Scheduled(cron = "0 0 2 * * ?") // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    public void runDailyQualityCheck() {
        List<QualityRule> activeRules = qualityRuleRepository.findByIsActiveTrue();
        
        for (QualityRule rule : activeRules) {
            QualityCheckResult result = executeQualityCheck(rule);
            
            // è®°å½•æ£€æŸ¥ç»“æœ
            saveQualityCheckResult(result);
            
            // å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œå‘é€å‘Šè­¦
            if (result.getValue() > rule.getThresholdValue()) {
                sendQualityAlert(rule, result);
            }
        }
    }
    
    private QualityCheckResult executeQualityCheck(QualityRule rule) {
        try {
            // æ‰§è¡Œè´¨é‡æ£€æŸ¥SQL
            Double value = jdbcTemplate.queryForObject(
                rule.getCheckSql(), Double.class
            );
            
            return QualityCheckResult.builder()
                .ruleId(rule.getId())
                .checkTime(LocalDateTime.now())
                .value(value)
                .status(value <= rule.getThresholdValue() ? "PASS" : "FAIL")
                .build();
                
        } catch (Exception ex) {
            return QualityCheckResult.error(rule.getId(), ex.getMessage());
        }
    }
}
```

### 8.2 æ‰¹é‡ä¿®å¤å·¥å…·


**ğŸ”¸ æ™ºèƒ½æ‰¹é‡ä¿®å¤**
```sql
-- åˆ›å»ºæ‰¹é‡ä¿®å¤ä»»åŠ¡è¡¨
CREATE TABLE batch_repair_tasks (
    id INT PRIMARY KEY AUTO_INCREMENT,
    task_name VARCHAR(100),
    table_name VARCHAR(100),
    repair_type VARCHAR(50),
    repair_sql TEXT,
    status ENUM('PENDING', 'RUNNING', 'COMPLETED', 'FAILED'),
    affected_rows INT DEFAULT 0,
    start_time TIMESTAMP NULL,
    end_time TIMESTAMP NULL,
    error_message TEXT NULL
);

-- æ‰¹é‡ä¿®å¤æ‰§è¡Œå¼•æ“
DELIMITER $$
CREATE PROCEDURE ExecuteBatchRepair(IN task_id INT)
BEGIN
    DECLARE v_repair_sql TEXT;
    DECLARE v_affected_rows INT DEFAULT 0;
    DECLARE v_error_message TEXT DEFAULT NULL;
    
    -- è·å–ä¿®å¤ä»»åŠ¡
    SELECT repair_sql INTO v_repair_sql
    FROM batch_repair_tasks 
    WHERE id = task_id;
    
    -- æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºè¿è¡Œä¸­
    UPDATE batch_repair_tasks 
    SET status = 'RUNNING', start_time = NOW() 
    WHERE id = task_id;
    
    BEGIN
        -- æ‰§è¡Œä¿®å¤SQL
        SET @sql = v_repair_sql;
        PREPARE stmt FROM @sql;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
        
        GET DIAGNOSTICS v_affected_rows = ROW_COUNT;
        
        -- æ ‡è®°ä»»åŠ¡å®Œæˆ
        UPDATE batch_repair_tasks 
        SET status = 'COMPLETED', 
            end_time = NOW(),
            affected_rows = v_affected_rows
        WHERE id = task_id;
        
    EXCEPTION WHEN OTHERS THEN
        -- è®°å½•é”™è¯¯ä¿¡æ¯
        GET DIAGNOSTICS CONDITION 1
            v_error_message = MESSAGE_TEXT;
            
        UPDATE batch_repair_tasks 
        SET status = 'FAILED', 
            end_time = NOW(),
            error_message = v_error_message
        WHERE id = task_id;
    END;
END $$
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 çº¦æŸå†²çªå¤„ç†æ ¸å¿ƒæ¦‚å¿µ


```
ğŸš¨ çº¦æŸå†²çªæœ¬è´¨ï¼š
â€¢ æ–°æ•°æ®è¿åå·²å®šä¹‰çš„å®Œæ•´æ€§è§„åˆ™
â€¢ æ•°æ®åº“è‡ªåŠ¨æ£€æµ‹å¹¶é˜»æ­¢è¿è§„æ“ä½œ
â€¢ éœ€è¦ç³»ç»ŸåŒ–çš„å¤„ç†æœºåˆ¶ä¿è¯æ•°æ®è´¨é‡

ğŸ”‘ å¤„ç†æµç¨‹è¦ç´ ï¼š
â€¢ æ£€æµ‹ï¼šå®æ—¶å‘ç°çº¦æŸè¿å
â€¢ è¯Šæ–­ï¼šåˆ†æå†²çªåŸå› å’Œå½±å“
â€¢ å¤„ç†ï¼šé€‰æ‹©åˆé€‚çš„è§£å†³ç­–ç•¥
â€¢ ä¿®å¤ï¼šæ‰§è¡Œæ•°æ®ä¿®æ­£æ“ä½œ
â€¢ ç›‘æ§ï¼šè·Ÿè¸ªå¤„ç†æ•ˆæœå’Œè¶‹åŠ¿
```

### 9.2 å†²çªå¤„ç†ç­–ç•¥ä½“ç³»


```
ğŸ”§ å¤„ç†ç­–ç•¥åˆ†ç±»ï¼š
â€¢ ç«‹å³å¤±è´¥ï¼šä¸¥æ ¼ä¿è¯æ•°æ®å‡†ç¡®æ€§
â€¢ è‡ªåŠ¨ä¿®å¤ï¼šæ™ºèƒ½å¤„ç†å¸¸è§å†²çª
â€¢ å¿½ç•¥å†²çªï¼šå¹‚ç­‰æ“ä½œåœºæ™¯
â€¢ å»¶è¿Ÿå¤„ç†ï¼šé«˜å¹¶å‘æ—¶çš„ç¼“å†²æœºåˆ¶

ğŸ¯ ç­–ç•¥é€‰æ‹©åŸåˆ™ï¼š
â€¢ ä¸šåŠ¡é‡è¦æ€§ï¼šå…³é”®æ•°æ®ä¸¥æ ¼å¤„ç†
â€¢ å†²çªé¢‘ç‡ï¼šé«˜é¢‘å†²çªè€ƒè™‘è‡ªåŠ¨åŒ–
â€¢ ä¿®å¤éš¾åº¦ï¼šç®€å•å†²çªå¯è‡ªåŠ¨ä¿®å¤
â€¢ æ€§èƒ½è¦æ±‚ï¼šé«˜å¹¶å‘æ—¶ä¼˜å…ˆä¿è¯æ€§èƒ½
```

### 9.3 è‡ªåŠ¨åŒ–ä¿®å¤æœºåˆ¶


```
ğŸ¤– è‡ªåŠ¨ä¿®å¤ä»·å€¼ï¼š
â€¢ å‡å°‘äººå·¥å¹²é¢„ï¼šæé«˜å¤„ç†æ•ˆç‡
â€¢ ä¿è¯å¤„ç†ä¸€è‡´æ€§ï¼šé¿å…äººä¸ºé”™è¯¯
â€¢ æå‡ç³»ç»Ÿå¯ç”¨æ€§ï¼šå‡å°‘å› å†²çªå¯¼è‡´çš„ä¸­æ–­
â€¢ é™ä½è¿ç»´æˆæœ¬ï¼šå‡å°‘æ‰‹åŠ¨å¤„ç†å·¥ä½œé‡

ğŸ”¥ æ™ºèƒ½ä¿®å¤ç‰¹ç‚¹ï¼š
â€¢ æ¨¡å¼è¯†åˆ«ï¼šå­¦ä¹ å†å²å†²çªæ¨¡å¼
â€¢ ç­–ç•¥é€‰æ‹©ï¼šæ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©æœ€ä½³æ–¹æ¡ˆ
â€¢ æ•ˆæœåé¦ˆï¼šè·Ÿè¸ªä¿®å¤æˆåŠŸç‡æŒç»­ä¼˜åŒ–
â€¢ é£é™©æ§åˆ¶ï¼šå…³é”®æ•°æ®ä»éœ€äººå·¥å®¡æ ¸
```

### 9.4 ç›‘æ§ä¸é¢„é˜²ä½“ç³»


```
ğŸ“Š ç›‘æ§ç»´åº¦ï¼š
â€¢ å†²çªé¢‘ç‡ï¼šå•ä½æ—¶é—´å†…çš„å†²çªæ¬¡æ•°
â€¢ ä¿®å¤æˆåŠŸç‡ï¼šè‡ªåŠ¨ä¿®å¤çš„æˆåŠŸæ¯”ä¾‹
â€¢ å¤„ç†æ—¶å»¶ï¼šä»æ£€æµ‹åˆ°è§£å†³çš„æ—¶é—´
â€¢ ä¸šåŠ¡å½±å“ï¼šå†²çªå¯¹ä¸šåŠ¡æµç¨‹çš„å½±å“

ğŸ›¡ï¸ é¢„é˜²æœºåˆ¶ï¼š
â€¢ è¾“å…¥éªŒè¯ï¼šåœ¨æ•°æ®è¿›å…¥æ•°æ®åº“å‰æ£€æŸ¥
â€¢ è´¨é‡é—¨æ§ï¼šæ‰¹é‡æ•°æ®é¢„æ£€æŸ¥æœºåˆ¶
â€¢ å®æ—¶å‘Šè­¦ï¼šå¼‚å¸¸æƒ…å†µåŠæ—¶é€šçŸ¥
â€¢ è¶‹åŠ¿åˆ†æï¼šé¢„æµ‹æ½œåœ¨çš„æ•°æ®è´¨é‡é—®é¢˜
```

### 9.5 å®é™…åº”ç”¨ä»·å€¼


```
ğŸ¯ ä¸šåŠ¡ä»·å€¼ï¼š
â€¢ ä¿è¯æ•°æ®è´¨é‡ï¼šç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§
â€¢ æå‡ç”¨æˆ·ä½“éªŒï¼šå‡å°‘å› æ•°æ®é”™è¯¯å¯¼è‡´çš„æ“ä½œå¤±è´¥
â€¢ é™ä½ç»´æŠ¤æˆæœ¬ï¼šè‡ªåŠ¨åŒ–å¤„ç†å‡å°‘äººå·¥ä»‹å…¥
â€¢ æ”¯æŒä¸šåŠ¡å‘å±•ï¼šç¨³å®šå¯é çš„æ•°æ®åŸºç¡€

ğŸ’¡ æŠ€æœ¯ä»·å€¼ï¼š
â€¢ ç³»ç»Ÿç¨³å®šæ€§ï¼šå‡å°‘å› çº¦æŸå†²çªå¯¼è‡´çš„ç³»ç»Ÿå¼‚å¸¸
â€¢ å¼€å‘æ•ˆç‡ï¼šæ ‡å‡†åŒ–çš„å†²çªå¤„ç†å‡å°‘é‡å¤å¼€å‘
â€¢ è¿ç»´æ•ˆç‡ï¼šè‡ªåŠ¨åŒ–ç›‘æ§å’Œä¿®å¤å‡å°‘è¿ç»´è´Ÿæ‹…
â€¢ æ•°æ®æ²»ç†ï¼šå»ºç«‹å®Œå–„çš„æ•°æ®è´¨é‡ç®¡ç†ä½“ç³»
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- çº¦æŸå†²çªè¦é¢„é˜²ï¼šè¾“å…¥éªŒè¯æ˜¯å…³é”®
- è‡ªåŠ¨ä¿®å¤ææ•ˆç‡ï¼šæ™ºèƒ½ç­–ç•¥å‡äººå·¥
- ç›‘æ§å‘Šè­¦ä¿è´¨é‡ï¼šåŠæ—¶å‘ç°æ—©å¤„ç†
- æ‰¹é‡å¤„ç†æœ‰ç­–ç•¥ï¼šåˆ†æ‰¹éš”ç¦»é™é£é™©