---
title: 7ã€MySQLè¡¨åˆ›å»ºé«˜çº§é€‰é¡¹
---
## ğŸ“š ç›®å½•

1. [é«˜çº§è¡¨é€‰é¡¹æ¦‚è¿°](#1-é«˜çº§è¡¨é€‰é¡¹æ¦‚è¿°)
2. [ç‰¹æ®Šè¡¨å¼•æ“ç±»å‹](#2-ç‰¹æ®Šè¡¨å¼•æ“ç±»å‹)
3. [è¡¨ç©ºé—´ä¸å­˜å‚¨æ ¼å¼](#3-è¡¨ç©ºé—´ä¸å­˜å‚¨æ ¼å¼)
4. [è¡¨çº§åŠ å¯†ä¸å®‰å…¨](#4-è¡¨çº§åŠ å¯†ä¸å®‰å…¨)
5. [åˆ†åŒºè¡¨è®¾è®¡](#5-åˆ†åŒºè¡¨è®¾è®¡)
6. [è¡¨çº§å‹ç¼©ä¸ä¼˜åŒ–](#6-è¡¨çº§å‹ç¼©ä¸ä¼˜åŒ–)
7. [è¡¨ç›‘æ§ä¸å®¡è®¡](#7-è¡¨ç›‘æ§ä¸å®¡è®¡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ› ï¸ é«˜çº§è¡¨é€‰é¡¹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯é«˜çº§è¡¨é€‰é¡¹


**ğŸ”¸ åŸºç¡€vsé«˜çº§è¡¨åˆ›å»º**
```sql
-- åŸºç¡€è¡¨åˆ›å»º
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(50)
);

-- é«˜çº§è¡¨åˆ›å»º
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(50)
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci
  ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=8
  TABLESPACE=user_space
  ENCRYPTION='Y';
```

**ğŸ’¡ é«˜çº§é€‰é¡¹çš„ä½œç”¨**
```
ä¸ºä»€ä¹ˆéœ€è¦é«˜çº§é€‰é¡¹ï¼š
â€¢ æ€§èƒ½ä¼˜åŒ–ï¼šé€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“å’Œå‹ç¼©æ–¹å¼
â€¢ å®‰å…¨å¢å¼ºï¼šè¡¨çº§åŠ å¯†ä¿æŠ¤æ•æ„Ÿæ•°æ®  
â€¢ å­˜å‚¨ç®¡ç†ï¼šçµæ´»çš„è¡¨ç©ºé—´å’Œåˆ†åŒºç­–ç•¥
â€¢ ç‰¹æ®Šéœ€æ±‚ï¼šè”åˆè¡¨ã€å¤–éƒ¨è¡¨ç­‰ç‰¹æ®Šåœºæ™¯

ä½¿ç”¨åŸåˆ™ï¼š
â€¢ é»˜è®¤é€‰é¡¹é€‚åˆå¤§éƒ¨åˆ†åœºæ™¯
â€¢ ç‰¹æ®Šéœ€æ±‚æ‰ä½¿ç”¨é«˜çº§é€‰é¡¹
â€¢ æ¯ä¸ªé€‰é¡¹éƒ½æœ‰æ€§èƒ½å’ŒåŠŸèƒ½çš„æƒè¡¡
â€¢ ç”Ÿäº§ç¯å¢ƒè¦å……åˆ†æµ‹è¯•
```

### 1.2 é«˜çº§é€‰é¡¹åˆ†ç±»


**ğŸ“‹ é€‰é¡¹åˆ†ç±»å›¾**
```
MySQLé«˜çº§è¡¨é€‰é¡¹
â”œâ”€â”€ å­˜å‚¨ç›¸å…³
â”‚   â”œâ”€â”€ ENGINE (å­˜å‚¨å¼•æ“)
â”‚   â”œâ”€â”€ TABLESPACE (è¡¨ç©ºé—´)
â”‚   â”œâ”€â”€ ROW_FORMAT (è¡Œæ ¼å¼)
â”‚   â””â”€â”€ KEY_BLOCK_SIZE (å‹ç¼©å—å¤§å°)
â”œâ”€â”€ å­—ç¬¦é›†ç›¸å…³
â”‚   â”œâ”€â”€ DEFAULT CHARSET (é»˜è®¤å­—ç¬¦é›†)
â”‚   â””â”€â”€ COLLATE (æ’åºè§„åˆ™)
â”œâ”€â”€ å®‰å…¨ç›¸å…³
â”‚   â”œâ”€â”€ ENCRYPTION (è¡¨åŠ å¯†)
â”‚   â””â”€â”€ PASSWORD (è¡¨å¯†ç )
â”œâ”€â”€ åˆ†åŒºç›¸å…³
â”‚   â”œâ”€â”€ PARTITION BY (åˆ†åŒºæ–¹å¼)
â”‚   â””â”€â”€ SUBPARTITION BY (å­åˆ†åŒº)
â””â”€â”€ ç‰¹æ®Šç±»å‹
    â”œâ”€â”€ UNION (è”åˆè¡¨)
    â”œâ”€â”€ INSERT_METHOD (æ’å…¥æ–¹æ³•)
    â””â”€â”€ CONNECTION (è¿æ¥ä¿¡æ¯)
```

### 1.3 é€‰é¡¹ä½¿ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯**
```
ç”µå•†ç³»ç»Ÿï¼š
â€¢ ç”¨æˆ·è¡¨ï¼šåŠ å¯†å­˜å‚¨ä¸ªäººä¿¡æ¯
â€¢ è®¢å•è¡¨ï¼šæŒ‰æ—¶é—´åˆ†åŒºï¼Œå‹ç¼©å­˜å‚¨
â€¢ æ—¥å¿—è¡¨ï¼šä½¿ç”¨CSVå¼•æ“ä¾¿äºåˆ†æ

é‡‘èç³»ç»Ÿï¼š
â€¢ äº¤æ˜“è¡¨ï¼šå¼ºåˆ¶åŠ å¯†ï¼Œå®¡è®¡æ—¥å¿—
â€¢ å†å²æ•°æ®ï¼šå‹ç¼©å­˜å‚¨ï¼Œç‹¬ç«‹è¡¨ç©ºé—´
â€¢ æŠ¥è¡¨æ•°æ®ï¼šè”åˆè¡¨æ±‡æ€»å¤šæºæ•°æ®

å¤§æ•°æ®åˆ†æï¼š
â€¢ åŸå§‹æ•°æ®ï¼šå¤–éƒ¨è¡¨ç›´æ¥è¯»å–æ–‡ä»¶
â€¢ èšåˆæ•°æ®ï¼šåˆ†åŒºè¡¨æé«˜æŸ¥è¯¢æ•ˆç‡
â€¢ ä¸´æ—¶æ•°æ®ï¼šå†…å­˜è¡¨å¿«é€Ÿå¤„ç†
```

---

## 2. ğŸ”§ ç‰¹æ®Šè¡¨å¼•æ“ç±»å‹


### 2.1 è”åˆè¡¨UNIONä½¿ç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯è”åˆè¡¨**
```
è”åˆè¡¨çš„æ¦‚å¿µï¼š
â€¢ å°†å¤šä¸ªç›¸åŒç»“æ„çš„MyISAMè¡¨é€»è¾‘ä¸Šåˆå¹¶
â€¢ æŸ¥è¯¢æ—¶è‡ªåŠ¨è®¿é—®æ‰€æœ‰åº•å±‚è¡¨
â€¢ æœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œåªæ˜¯ä¸€ä¸ªè§†å›¾å±‚

ä½¿ç”¨åœºæ™¯ï¼š
â€¢ å†å²æ•°æ®å½’æ¡£ï¼šæŒ‰å¹´ä»½æ‹†åˆ†çš„è¡¨
â€¢ æ—¥å¿—æ•°æ®åˆå¹¶ï¼šå¤šä¸ªæ¥æºçš„æ—¥å¿—è¡¨
â€¢ æ•°æ®åˆ†ç‰‡ï¼šæ°´å¹³åˆ†å‰²çš„å¤§è¡¨
```

**ğŸ”§ è”åˆè¡¨åˆ›å»ºç¤ºä¾‹**
```sql
-- 1. åˆ›å»ºåº•å±‚è¡¨ï¼ˆå¿…é¡»æ˜¯MyISAMå¼•æ“ï¼‰
CREATE TABLE sales_2023 (
    id INT AUTO_INCREMENT,
    product_id INT NOT NULL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10,2),
    INDEX(id)
) ENGINE=MyISAM;

CREATE TABLE sales_2024 (
    id INT AUTO_INCREMENT,
    product_id INT NOT NULL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10,2),
    INDEX(id)
) ENGINE=MyISAM;

CREATE TABLE sales_2025 (
    id INT AUTO_INCREMENT,
    product_id INT NOT NULL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10,2),
    INDEX(id)
) ENGINE=MyISAM;

-- 2. åˆ›å»ºè”åˆè¡¨
CREATE TABLE sales_all (
    id INT AUTO_INCREMENT,
    product_id INT NOT NULL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10,2),
    INDEX(id)
) ENGINE=MERGE 
  UNION=(sales_2023, sales_2024, sales_2025)
  INSERT_METHOD=LAST;  -- æ–°æ•°æ®æ’å…¥åˆ°æœ€åä¸€ä¸ªè¡¨

-- 3. æŸ¥è¯¢è”åˆè¡¨
SELECT product_id, SUM(amount) as total_sales
FROM sales_all 
WHERE sale_date >= '2023-01-01'
GROUP BY product_id;
```

**ğŸ’¡ INSERT_METHODé€‰é¡¹è¯´æ˜**
```sql
INSERT_METHODé€‰é¡¹ï¼š
â€¢ FIRSTï¼šæ’å…¥åˆ°ç¬¬ä¸€ä¸ªè¡¨
â€¢ LASTï¼šæ’å…¥åˆ°æœ€åä¸€ä¸ªè¡¨  
â€¢ NOï¼šä¸å…è®¸æ’å…¥ï¼ˆåªè¯»è”åˆè¡¨ï¼‰

-- å®é™…ä½¿ç”¨ç¤ºä¾‹
CREATE TABLE active_orders (
    order_id INT,
    customer_id INT,
    order_date DATE,
    status VARCHAR(20)
) ENGINE=MERGE
  UNION=(pending_orders, processing_orders)
  INSERT_METHOD=FIRST;  -- æ–°è®¢å•æ’å…¥pending_orders

-- æŸ¥è¯¢æ‰€æœ‰æ´»è·ƒè®¢å•
SELECT * FROM active_orders WHERE status IN ('pending', 'processing');
```

### 2.2 CSVè¡¨å¼•æ“åº”ç”¨


**ğŸ”¸ CSVè¡¨å¼•æ“çš„ç‰¹ç‚¹**
```
CSVè¡¨å¼•æ“ç”¨é€”ï¼š
â€¢ ä¸å¤–éƒ¨ç³»ç»Ÿæ•°æ®äº¤æ¢
â€¢ å¯¼å…¥å¯¼å‡ºå¤§é‡æ•°æ®
â€¢ æ—¥å¿—æ•°æ®çš„å¿«é€Ÿå­˜å‚¨
â€¢ æ•°æ®åˆ†æçš„ä¸´æ—¶è¡¨

ä¼˜åŠ¿ï¼š
â€¢ æ•°æ®æ–‡ä»¶å¯ç›´æ¥ç¼–è¾‘
â€¢ ä¸Excelç­‰å·¥å…·å…¼å®¹
â€¢ å¯¼å…¥å¯¼å‡ºé€Ÿåº¦å¿«
â€¢ å ç”¨ç©ºé—´å°

é™åˆ¶ï¼š
â€¢ ä¸æ”¯æŒç´¢å¼•ï¼ˆé™¤äº†ä¸»é”®ï¼‰
â€¢ ä¸æ”¯æŒAUTO_INCREMENT
â€¢ æ‰€æœ‰åˆ—éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹
â€¢ ä¸æ”¯æŒäº‹åŠ¡
```

**ğŸ”§ CSVè¡¨åˆ›å»ºå’Œä½¿ç”¨**
```sql
-- åˆ›å»ºCSVè¡¨
CREATE TABLE sales_data_csv (
    id INT NOT NULL,
    product_name VARCHAR(100),
    sales_date VARCHAR(10),
    quantity VARCHAR(10),
    price VARCHAR(20),
    PRIMARY KEY (id)
) ENGINE=CSV;

-- æ’å…¥æ•°æ®
INSERT INTO sales_data_csv VALUES 
(1, 'iPhone 14', '2024-01-15', '100', '5999.00'),
(2, 'MacBook Pro', '2024-01-16', '50', '12999.00'),
(3, 'iPad Air', '2024-01-17', '200', '3899.00');

-- æŸ¥çœ‹æ•°æ®æ–‡ä»¶ä½ç½®
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    ENGINE,
    DATA_FREE
FROM information_schema.TABLES 
WHERE TABLE_NAME = 'sales_data_csv';

-- ç›´æ¥æ“ä½œCSVæ–‡ä»¶
-- æ–‡ä»¶ä½ç½®é€šå¸¸åœ¨: /var/lib/mysql/database_name/table_name.CSV
```

**ğŸ“ CSVè¡¨æ–‡ä»¶æ“ä½œ**
```bash
# æŸ¥çœ‹CSVæ–‡ä»¶å†…å®¹
cat /var/lib/mysql/mydb/sales_data_csv.CSV
# è¾“å‡ºï¼š
# 1,"iPhone 14","2024-01-15","100","5999.00"
# 2,"MacBook Pro","2024-01-16","50","12999.00"
# 3,"iPad Air","2024-01-17","200","3899.00"

# ç›´æ¥ç¼–è¾‘CSVæ–‡ä»¶æ·»åŠ æ•°æ®
echo '4,"Apple Watch","2024-01-18","300","2499.00"' >> /var/lib/mysql/mydb/sales_data_csv.CSV

# åˆ·æ–°è¡¨ä»¥é‡æ–°è¯»å–æ–‡ä»¶
mysql -e "FLUSH TABLE sales_data_csv;"
```

### 2.3 FEDERATEDå¤–éƒ¨è¡¨è¿æ¥


**ğŸ”¸ FEDERATEDè¡¨çš„æ¦‚å¿µ**
```
FEDERATEDè¡¨çš„ä½œç”¨ï¼š
â€¢ è®¿é—®è¿œç¨‹MySQLæœåŠ¡å™¨ä¸Šçš„è¡¨
â€¢ å®ç°æ•°æ®åº“é—´çš„è¡¨çº§è¿æ¥
â€¢ ä¸åœ¨æœ¬åœ°å­˜å‚¨æ•°æ®ï¼Œåªæ˜¯ä¸€ä¸ªä»£ç†

å·¥ä½œåŸç†ï¼š
æœ¬åœ°æŸ¥è¯¢ â†’ FEDERATEDè¡¨ â†’ ç½‘ç»œè¿æ¥ â†’ è¿œç¨‹MySQLæœåŠ¡å™¨

ä½¿ç”¨åœºæ™¯ï¼š
â€¢ åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„
â€¢ æ•°æ®ä»“åº“ETLè¿‡ç¨‹
â€¢ è·¨æ•°æ®ä¸­å¿ƒæ•°æ®è®¿é—®
â€¢ å†å²æ•°æ®å½’æ¡£æŸ¥è¯¢
```

**ğŸ”§ FEDERATEDè¡¨é…ç½®**
```sql
-- 1. åœ¨è¿œç¨‹æœåŠ¡å™¨åˆ›å»ºæºè¡¨
-- è¿œç¨‹æœåŠ¡å™¨ï¼š192.168.1.100
CREATE TABLE remote_customers (
    customer_id INT PRIMARY KEY,
    customer_name VARCHAR(100),
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- æ’å…¥ä¸€äº›æµ‹è¯•æ•°æ®
INSERT INTO remote_customers VALUES
(1, 'å¼ ä¸‰', 'zhangsan@email.com', NOW()),
(2, 'æå››', 'lisi@email.com', NOW());

-- 2. åœ¨æœ¬åœ°æœåŠ¡å™¨åˆ›å»ºFEDERATEDè¡¨
CREATE TABLE local_customers (
    customer_id INT,
    customer_name VARCHAR(100),
    email VARCHAR(100),
    created_at TIMESTAMP
) ENGINE=FEDERATED
  CONNECTION='mysql://username:password@192.168.1.100:3306/remote_db/remote_customers';

-- 3. é€šè¿‡æœ¬åœ°è¡¨è®¿é—®è¿œç¨‹æ•°æ®
SELECT * FROM local_customers;
-- è¿™ä¸ªæŸ¥è¯¢å®é™…ä¸Šæ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œçš„

-- 4. æœ¬åœ°æ’å…¥æ•°æ®ä¼šåŒæ­¥åˆ°è¿œç¨‹
INSERT INTO local_customers (customer_id, customer_name, email) 
VALUES (3, 'ç‹äº”', 'wangwu@email.com');
```

**âš ï¸ FEDERATEDè¡¨æ³¨æ„äº‹é¡¹**
```sql
-- è¿æ¥å­—ç¬¦ä¸²æ ¼å¼
CONNECTION='mysql://user:password@host:port/database/table'

-- å®‰å…¨é…ç½®
-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·ç”¨äºFEDERATEDè¿æ¥
CREATE USER 'federated_user'@'192.168.1.%' 
IDENTIFIED BY 'secure_password';

GRANT SELECT, INSERT, UPDATE, DELETE 
ON remote_db.remote_customers 
TO 'federated_user'@'192.168.1.%';

-- ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·çš„è¿æ¥å­—ç¬¦ä¸²
CONNECTION='mysql://federated_user:secure_password@192.168.1.100:3306/remote_db/remote_customers'

-- æ€§èƒ½æ³¨æ„äº‹é¡¹
-- FEDERATEDè¡¨ä¸æ”¯æŒçš„åŠŸèƒ½ï¼š
-- âœ— ä¸æ”¯æŒç´¢å¼•ï¼ˆåœ¨æœ¬åœ°ï¼‰
-- âœ— ä¸æ”¯æŒäº‹åŠ¡ï¼ˆè·¨ç½‘ç»œï¼‰
-- âœ— ä¸æ”¯æŒå¤–é”®
-- âœ— æ€§èƒ½ä¾èµ–ç½‘ç»œå»¶è¿Ÿ
```

### 2.4 MERGEåˆå¹¶è¡¨è¯¦è§£


**ğŸ”¸ MERGEè¡¨vsè”åˆè¡¨çš„åŒºåˆ«**
```
æ¦‚å¿µæ¾„æ¸…ï¼š
â€¢ MERGEè¡¨ = UNIONè¡¨ (åŒä¸€ä¸ªä¸œè¥¿çš„ä¸åŒå«æ³•)
â€¢ éƒ½æ˜¯æŒ‡å°†å¤šä¸ªMyISAMè¡¨é€»è¾‘åˆå¹¶
â€¢ ENGINE=MERGE å’Œ ENGINE=UNION æ•ˆæœç›¸åŒ

ä¸UNIONæŸ¥è¯¢çš„åŒºåˆ«ï¼š
â€¢ MERGEè¡¨ï¼šç‰©ç†ä¸Šçš„è¡¨ç»“æ„ï¼ŒæŒä¹…å­˜åœ¨
â€¢ UNIONæŸ¥è¯¢ï¼šä¸´æ—¶çš„æŸ¥è¯¢ç»“æœé›†ï¼Œä¸æŒä¹…
```

**ğŸ”§ MERGEè¡¨é«˜çº§é…ç½®**
```sql
-- åˆ›å»ºåˆ†è¡¨å­˜å‚¨ä¸åŒåœ°åŒºæ•°æ®
CREATE TABLE orders_north (
    order_id INT AUTO_INCREMENT,
    customer_id INT,
    order_date DATE,
    region VARCHAR(10) DEFAULT 'NORTH',
    amount DECIMAL(10,2),
    PRIMARY KEY (order_id),
    KEY idx_date (order_date),
    KEY idx_customer (customer_id)
) ENGINE=MyISAM;

CREATE TABLE orders_south (
    order_id INT AUTO_INCREMENT,
    customer_id INT,
    order_date DATE,
    region VARCHAR(10) DEFAULT 'SOUTH',
    amount DECIMAL(10,2),
    PRIMARY KEY (order_id),
    KEY idx_date (order_date),
    KEY idx_customer (customer_id)
) ENGINE=MyISAM;

-- åˆ›å»ºåˆå¹¶è¡¨
CREATE TABLE orders_all (
    order_id INT AUTO_INCREMENT,
    customer_id INT,
    order_date DATE,
    region VARCHAR(10),
    amount DECIMAL(10,2),
    PRIMARY KEY (order_id),
    KEY idx_date (order_date),
    KEY idx_customer (customer_id)
) ENGINE=MERGE
  UNION=(orders_north, orders_south)
  INSERT_METHOD=LAST;

-- åŠ¨æ€ä¿®æ”¹UNIONè¡¨åˆ—è¡¨
ALTER TABLE orders_all 
UNION=(orders_north, orders_south, orders_east, orders_west);
```

**ğŸ“Š MERGEè¡¨æŸ¥è¯¢æ€§èƒ½**
```sql
-- æŸ¥è¯¢ä¼˜åŒ–ç¤ºä¾‹
-- å¥½çš„æŸ¥è¯¢ï¼šèƒ½åˆ©ç”¨åˆ†è¡¨çš„ç´¢å¼•
SELECT * FROM orders_all 
WHERE order_date BETWEEN '2024-01-01' AND '2024-01-31'
AND customer_id = 1001;

-- ä¸å¥½çš„æŸ¥è¯¢ï¼šéœ€è¦æ‰«ææ‰€æœ‰åˆ†è¡¨
SELECT * FROM orders_all 
ORDER BY amount DESC 
LIMIT 10;

-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM orders_all WHERE order_date = '2024-01-15';
```

---

## 3. ğŸ’¾ è¡¨ç©ºé—´ä¸å­˜å‚¨æ ¼å¼


### 3.1 è¡¨ç©ºé—´TABLESPACEæŒ‡å®š


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¡¨ç©ºé—´**
```
è¡¨ç©ºé—´çš„æ¦‚å¿µï¼š
â€¢ è¡¨ç©ºé—´æ˜¯å­˜å‚¨è¡¨æ•°æ®çš„é€»è¾‘å®¹å™¨
â€¢ å¯ä»¥å°†è¡¨æ•°æ®å­˜å‚¨åœ¨æŒ‡å®šçš„ç£ç›˜ä½ç½®
â€¢ ä¾¿äºæ•°æ®ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ–

MySQLè¡¨ç©ºé—´ç±»å‹ï¼š
â€¢ ç³»ç»Ÿè¡¨ç©ºé—´ï¼šibdata1ï¼Œå­˜å‚¨ç³»ç»Ÿæ•°æ®
â€¢ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šæ¯ä¸ªè¡¨ä¸€ä¸ª.ibdæ–‡ä»¶
â€¢ é€šç”¨è¡¨ç©ºé—´ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„å…±äº«è¡¨ç©ºé—´
â€¢ ä¸´æ—¶è¡¨ç©ºé—´ï¼šå­˜å‚¨ä¸´æ—¶è¡¨å’Œå†…éƒ¨ä¸´æ—¶è¡¨
```

**ğŸ”§ è‡ªå®šä¹‰è¡¨ç©ºé—´åˆ›å»º**
```sql
-- 1. åˆ›å»ºé€šç”¨è¡¨ç©ºé—´
CREATE TABLESPACE fast_storage 
ADD DATAFILE '/ssd/mysql/fast_storage.ibd' 
FILE_BLOCK_SIZE=16K
ENGINE=InnoDB;

CREATE TABLESPACE archive_storage
ADD DATAFILE '/slow/mysql/archive_storage.ibd'
FILE_BLOCK_SIZE=16K  
ENGINE=InnoDB;

-- 2. æŸ¥çœ‹è¡¨ç©ºé—´ä¿¡æ¯
SELECT 
    TABLESPACE_NAME,
    FILE_NAME,
    FILE_SIZE/1024/1024 AS 'SIZE_MB',
    AUTOEXTEND_SIZE
FROM information_schema.FILES 
WHERE TABLESPACE_NAME IN ('fast_storage', 'archive_storage');

-- 3. åœ¨æŒ‡å®šè¡¨ç©ºé—´åˆ›å»ºè¡¨
-- é«˜é¢‘è®¿é—®è¡¨æ”¾åœ¨SSDè¡¨ç©ºé—´
CREATE TABLE hot_data (
    id INT PRIMARY KEY,
    data JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) TABLESPACE=fast_storage;

-- å½’æ¡£æ•°æ®æ”¾åœ¨æ™®é€šç£ç›˜è¡¨ç©ºé—´
CREATE TABLE archive_data (
    id INT PRIMARY KEY,
    content TEXT,
    archived_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) TABLESPACE=archive_storage;

-- 4. ç§»åŠ¨ç°æœ‰è¡¨åˆ°æ–°è¡¨ç©ºé—´
ALTER TABLE existing_table TABLESPACE=fast_storage;
```

**ğŸ“Š è¡¨ç©ºé—´ä½¿ç”¨ç­–ç•¥**
```sql
-- æŒ‰æ•°æ®ç‰¹æ€§åˆ†é…è¡¨ç©ºé—´
CREATE TABLESPACE ssd_space ADD DATAFILE '/ssd/mysql/ssd.ibd';     -- é«˜æ€§èƒ½SSD
CREATE TABLESPACE hdd_space ADD DATAFILE '/hdd/mysql/hdd.ibd';     -- å¤§å®¹é‡æœºæ¢°ç›˜
CREATE TABLESPACE nvme_space ADD DATAFILE '/nvme/mysql/nvme.ibd';  -- æé€ŸNVMe

-- çƒ­ç‚¹æ•°æ®è¡¨
CREATE TABLE user_sessions (
    session_id VARCHAR(128) PRIMARY KEY,
    user_id INT,
    login_time TIMESTAMP,
    last_activity TIMESTAMP
) TABLESPACE=nvme_space;

-- æ¸©æ•°æ®è¡¨  
CREATE TABLE user_profiles (
    user_id INT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100),
    profile_data JSON
) TABLESPACE=ssd_space;

-- å†·æ•°æ®è¡¨
CREATE TABLE user_logs (
    log_id BIGINT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100),
    log_data TEXT,
    created_at TIMESTAMP
) TABLESPACE=hdd_space;
```

### 3.2 å­˜å‚¨æ ¼å¼FORMATæŒ‡å®š


**ğŸ”¸ è¡Œæ ¼å¼ROW_FORMATé€‰é¡¹**
```
InnoDBæ”¯æŒçš„è¡Œæ ¼å¼ï¼š
â€¢ REDUNDANTï¼šæ—§æ ¼å¼ï¼Œå…¼å®¹æ€§å¥½
â€¢ COMPACTï¼šç´§å‡‘æ ¼å¼ï¼ŒèŠ‚çœç©ºé—´ï¼ˆé»˜è®¤ï¼‰
â€¢ DYNAMICï¼šåŠ¨æ€æ ¼å¼ï¼Œæ”¯æŒå¤§å¯¹è±¡
â€¢ COMPRESSEDï¼šå‹ç¼©æ ¼å¼ï¼Œæœ€çœç©ºé—´

é€‰æ‹©åŸåˆ™ï¼š
â€¢ COMPACTï¼šä¸€èˆ¬åœºæ™¯çš„é»˜è®¤é€‰æ‹©
â€¢ DYNAMICï¼šæœ‰å¤§å­—æ®µ(TEXT/BLOB)æ—¶ä½¿ç”¨
â€¢ COMPRESSEDï¼šå­˜å‚¨ç©ºé—´ç´§å¼ æ—¶ä½¿ç”¨
â€¢ REDUNDANTï¼šå…¼å®¹è€ç‰ˆæœ¬æ—¶ä½¿ç”¨
```

**ğŸ”§ ä¸åŒè¡Œæ ¼å¼çš„å®é™…åº”ç”¨**
```sql
-- 1. æ™®é€šä¸šåŠ¡è¡¨ - ä½¿ç”¨COMPACTæ ¼å¼
CREATE TABLE products (
    product_id INT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2),
    description TEXT
) ENGINE=InnoDB 
  ROW_FORMAT=COMPACT;

-- 2. å¤§å¯¹è±¡å­˜å‚¨è¡¨ - ä½¿ç”¨DYNAMICæ ¼å¼  
CREATE TABLE documents (
    doc_id INT PRIMARY KEY,
    title VARCHAR(200),
    content LONGTEXT,      -- å¤§æ–‡æœ¬å­—æ®µ
    metadata JSON,         -- JSONå­—æ®µ
    file_data LONGBLOB     -- å¤§äºŒè¿›åˆ¶å­—æ®µ
) ENGINE=InnoDB
  ROW_FORMAT=DYNAMIC;

-- 3. å½’æ¡£æ•°æ®è¡¨ - ä½¿ç”¨COMPRESSEDæ ¼å¼
CREATE TABLE user_activity_archive (
    id BIGINT PRIMARY KEY,
    user_id INT,
    activity_data JSON,
    raw_log TEXT,
    created_at TIMESTAMP
) ENGINE=InnoDB
  ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=8;      -- 8KBå‹ç¼©å—

-- 4. å…¼å®¹æ€§è¡¨ - ä½¿ç”¨REDUNDANTæ ¼å¼
CREATE TABLE legacy_data (
    id INT PRIMARY KEY,
    old_format_data VARCHAR(255)
) ENGINE=InnoDB
  ROW_FORMAT=REDUNDANT;
```

**ğŸ“Š è¡Œæ ¼å¼æ€§èƒ½å¯¹æ¯”**
```sql
-- æµ‹è¯•ä¸åŒè¡Œæ ¼å¼çš„ç©ºé—´ä½¿ç”¨
-- åˆ›å»ºæµ‹è¯•æ•°æ®
CREATE TABLE test_compact (
    id INT PRIMARY KEY,
    data VARCHAR(1000)
) ENGINE=InnoDB ROW_FORMAT=COMPACT;

CREATE TABLE test_compressed (
    id INT PRIMARY KEY,
    data VARCHAR(1000)
) ENGINE=InnoDB ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;

-- æ’å…¥ç›¸åŒæµ‹è¯•æ•°æ®
INSERT INTO test_compact 
SELECT seq, REPEAT('A', 500) FROM seq_1_to_10000;

INSERT INTO test_compressed 
SELECT seq, REPEAT('A', 500) FROM seq_1_to_10000;

-- æ¯”è¾ƒè¡¨å¤§å°
SELECT 
    TABLE_NAME,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'DATA_MB',
    ROUND(INDEX_LENGTH/1024/1024, 2) AS 'INDEX_MB',
    ROUND((DATA_LENGTH+INDEX_LENGTH)/1024/1024, 2) AS 'TOTAL_MB'
FROM information_schema.TABLES 
WHERE TABLE_NAME IN ('test_compact', 'test_compressed');
```

### 3.3 è¡¨çº§å‹ç¼©ç®—æ³•é€‰æ‹©


**ğŸ”¸ å‹ç¼©æœºåˆ¶ç†è§£**
```
MySQLå‹ç¼©å·¥ä½œåŸç†ï¼š
â€¢ é¡µçº§å‹ç¼©ï¼šä»¥é¡µä¸ºå•ä½è¿›è¡Œå‹ç¼©å­˜å‚¨
â€¢ é€æ˜å‹ç¼©ï¼šåº”ç”¨å±‚æ— éœ€å…³å¿ƒå‹ç¼©ç»†èŠ‚  
â€¢ åŠ¨æ€è§£å‹ï¼šæŸ¥è¯¢æ—¶è‡ªåŠ¨è§£å‹æ•°æ®
â€¢ ç¼“å­˜ä¼˜åŒ–ï¼šå‹ç¼©æ•°æ®å’ŒåŸå§‹æ•°æ®éƒ½å¯èƒ½è¢«ç¼“å­˜

å‹ç¼©ç®—æ³•ï¼š
â€¢ zlibï¼šé»˜è®¤å‹ç¼©ç®—æ³•ï¼Œå¹³è¡¡å‹ç¼©ç‡å’Œæ€§èƒ½
â€¢ lz4ï¼šé«˜æ€§èƒ½å‹ç¼©ï¼Œé€Ÿåº¦å¿«ä½†å‹ç¼©ç‡è¾ƒä½
â€¢ zstdï¼šæ–°ä¸€ä»£å‹ç¼©ç®—æ³•ï¼Œæ›´å¥½çš„å‹ç¼©ç‡
```

**ğŸ”§ å‹ç¼©é…ç½®å®è·µ**
```sql
-- 1. åŸºç¡€å‹ç¼©è¡¨
CREATE TABLE compressed_logs (
    log_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    log_message TEXT,
    log_data JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB
  ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=8;      -- 8KBå‹ç¼©å—å¤§å°

-- 2. ä¸åŒå‹ç¼©å—å¤§å°çš„é€‰æ‹©
-- å°è®°å½•ç”¨å°å—å¤§å°
CREATE TABLE small_records (
    id INT PRIMARY KEY,
    code VARCHAR(20),
    name VARCHAR(50)
) ENGINE=InnoDB
  ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=1;      -- 1KBå—ï¼Œé€‚åˆå°è®°å½•

-- å¤§è®°å½•ç”¨å¤§å—å¤§å°
CREATE TABLE large_records (
    id INT PRIMARY KEY,
    content LONGTEXT,
    binary_data LONGBLOB
) ENGINE=InnoDB
  ROW_FORMAT=COMPRESSED  
  KEY_BLOCK_SIZE=16;     -- 16KBå—ï¼Œé€‚åˆå¤§è®°å½•

-- 3. æŸ¥çœ‹å‹ç¼©æ•ˆæœ
SELECT 
    TABLE_NAME,
    ROW_FORMAT,
    CREATE_OPTIONS,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'DATA_MB',
    ROUND(DATA_FREE/1024/1024, 2) AS 'FREE_MB',
    ROUND((DATA_LENGTH-DATA_FREE)/DATA_LENGTH*100, 2) AS 'COMPRESSION_RATIO%'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = DATABASE()
AND ROW_FORMAT = 'Compressed';
```

**âš¡ å‹ç¼©æ€§èƒ½è°ƒä¼˜**
```sql
-- å‹ç¼©ç›¸å…³ç³»ç»Ÿå˜é‡
SHOW VARIABLES LIKE '%compress%';

-- å…³é”®é…ç½®å‚æ•°
SET GLOBAL innodb_compression_level = 6;        -- å‹ç¼©çº§åˆ«(1-9)
SET GLOBAL innodb_compression_failure_threshold_pct = 5;  -- å‹ç¼©å¤±è´¥é˜ˆå€¼
SET GLOBAL innodb_compression_pad_pct_max = 50;  -- å‹ç¼©å¡«å……æœ€å¤§ç™¾åˆ†æ¯”

-- ç›‘æ§å‹ç¼©æ•ˆæœ
SELECT 
    VARIABLE_NAME,
    VARIABLE_VALUE
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME LIKE '%compress%';
```

---

## 4. ğŸ” è¡¨çº§åŠ å¯†ä¸å®‰å…¨


### 4.1 é€æ˜æ•°æ®åŠ å¯†TDE


**ğŸ”¸ TDEåŠ å¯†æ¦‚å¿µ**
```
é€æ˜æ•°æ®åŠ å¯†(TDE)ï¼š
â€¢ æ•°æ®åœ¨ç£ç›˜ä¸Šä»¥åŠ å¯†å½¢å¼å­˜å‚¨
â€¢ åº”ç”¨ç¨‹åºæ— éœ€ä¿®æ”¹ï¼ŒåŠ è§£å¯†è‡ªåŠ¨è¿›è¡Œ
â€¢ ä¿æŠ¤æ•°æ®æ–‡ä»¶ã€å¤‡ä»½æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶
â€¢ å³ä½¿ç£ç›˜è¢«ç›—ä¹Ÿæ— æ³•ç›´æ¥è¯»å–æ•°æ®

MySQL TDEç‰¹ç‚¹ï¼š
â€¢ è¡¨çº§åŠ å¯†ï¼šå¯ä»¥é€‰æ‹©æ€§åŠ å¯†æ•æ„Ÿè¡¨
â€¢ å¯†é’¥ç®¡ç†ï¼šæ”¯æŒæœ¬åœ°å’Œä¼ä¸šçº§å¯†é’¥ç®¡ç†
â€¢ æ€§èƒ½å½±å“ï¼šè½»å¾®çš„CPUå¼€é”€ï¼ŒIOæ€§èƒ½åŸºæœ¬æ— å½±å“
```

**ğŸ”§ TDEåŠ å¯†é…ç½®**
```sql
-- 1. å¯ç”¨åŠ å¯†æ’ä»¶ï¼ˆéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼‰
-- my.cnfé…ç½®ï¼š
-- [mysqld]
-- early-plugin-load=keyring_file.so
-- keyring_file_data=/var/lib/mysql-keyring/keyring

-- 2. åˆ›å»ºåŠ å¯†è¡¨
CREATE TABLE sensitive_data (
    id INT PRIMARY KEY,
    ssn VARCHAR(20),           -- ç¤¾ä¼šä¿éšœå·
    credit_card VARCHAR(20),   -- ä¿¡ç”¨å¡å·
    bank_account VARCHAR(30),  -- é“¶è¡Œè´¦å·
    salary DECIMAL(10,2),      -- è–ªèµ„ä¿¡æ¯
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB 
  ENCRYPTION='Y';            -- å¼€å¯è¡¨çº§åŠ å¯†

-- 3. ä¸ºç°æœ‰è¡¨å¼€å¯åŠ å¯†
ALTER TABLE user_private_info ENCRYPTION='Y';

-- 4. æŸ¥çœ‹è¡¨åŠ å¯†çŠ¶æ€
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    CREATE_OPTIONS
FROM information_schema.TABLES 
WHERE CREATE_OPTIONS LIKE '%ENCRYPTION%';

-- 5. å…³é—­è¡¨åŠ å¯†
ALTER TABLE sensitive_data ENCRYPTION='N';
```

### 4.2 è¡¨çº§åŠ å¯†å¯†é’¥ç®¡ç†


**ğŸ” å¯†é’¥ç®¡ç†ç­–ç•¥**
```sql
-- æŸ¥çœ‹å¯†é’¥ä¿¡æ¯
SELECT * FROM performance_schema.keyring_keys;

-- æ‰‹åŠ¨ç”Ÿæˆè¡¨åŠ å¯†å¯†é’¥
SELECT keyring_key_generate('table_key_001', 'AES', 32);

-- æŸ¥çœ‹å¯†é’¥çŠ¶æ€
SELECT 
    KEY_ID,
    KEY_OWNER,
    BACKEND_KEY_ID
FROM performance_schema.keyring_keys 
WHERE KEY_ID LIKE 'table_%';

-- å¯†é’¥è½®æ¢ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
ALTER INSTANCE ROTATE INNODB MASTER KEY;
```

**ğŸ›¡ï¸ ä¼ä¸šçº§å¯†é’¥ç®¡ç†**
```bash
# 1. ä½¿ç”¨HashiCorp Vaultç®¡ç†å¯†é’¥
# my.cnfé…ç½®
[mysqld]
early-plugin-load=keyring_hashicorp.so
keyring_hashicorp_role_id=mysql-role
keyring_hashicorp_secret_id_path=/opt/mysql/vault-secret
keyring_hashicorp_store_path=/opt/mysql/vault-store
keyring_hashicorp_auth_path=/v1/auth/approle/login

# 2. ä½¿ç”¨AWS KMSç®¡ç†å¯†é’¥
[mysqld]
early-plugin-load=keyring_aws.so
keyring_aws_region=us-east-1
keyring_aws_cmk_id=arn:aws:kms:us-east-1:123456789:key/12345678-1234
```

### 4.3 åŠ å¯†è¡¨çš„å¤‡ä»½ä¸æ¢å¤


**ğŸ’¾ åŠ å¯†è¡¨å¤‡ä»½ç­–ç•¥**
```bash
#!/bin/bash
# åŠ å¯†è¡¨å¤‡ä»½è„šæœ¬

# 1. é€»è¾‘å¤‡ä»½ï¼ˆmysqldumpï¼‰
# å¤‡ä»½æ—¶æ•°æ®ä¼šè¢«è§£å¯†ï¼Œéœ€è¦ä¿æŠ¤å¤‡ä»½æ–‡ä»¶
mysqldump --single-transaction \
          --routines \
          --triggers \
          --all-databases \
          --password=${MYSQL_ROOT_PASSWORD} \
          | gzip > encrypted_backup_$(date +%Y%m%d).sql.gz

# 2. ç‰©ç†å¤‡ä»½ï¼ˆmysqlbackup/xtrabackupï¼‰
# å¤‡ä»½æ–‡ä»¶ä¿æŒåŠ å¯†çŠ¶æ€
mysqlbackup --backup-dir=/backup/$(date +%Y%m%d) \
           --with-timestamp \
           backup-and-apply-log

# 3. å¤‡ä»½æ–‡ä»¶å†æ¬¡åŠ å¯†
gpg --symmetric --cipher-algo AES256 \
    encrypted_backup_$(date +%Y%m%d).sql.gz
```

---

## 5. ğŸ“Š åˆ†åŒºè¡¨è®¾è®¡


### 5.1 åˆ†åŒºè¡¨åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯åˆ†åŒºè¡¨**
```
åˆ†åŒºè¡¨çš„æœ¬è´¨ï¼š
â€¢ å°†ä¸€ä¸ªå¤§è¡¨é€»è¾‘ä¸Šåˆ†æˆå¤šä¸ªå°è¡¨
â€¢ å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜
â€¢ MySQLè‡ªåŠ¨ç®¡ç†åˆ†åŒºæ•°æ®å­˜æ”¾
â€¢ æŸ¥è¯¢æ—¶è‡ªåŠ¨é€‰æ‹©ç›¸å…³åˆ†åŒº

åˆ†åŒºçš„å¥½å¤„ï¼š
â€¢ æŸ¥è¯¢æ€§èƒ½ï¼šåªæ‰«æç›¸å…³åˆ†åŒº
â€¢ ç®¡ç†ä¾¿åˆ©ï¼šå¯ä»¥ç‹¬ç«‹ç»´æŠ¤åˆ†åŒº
â€¢ å¹¶è¡Œå¤„ç†ï¼šå¤šåˆ†åŒºå¯å¹¶è¡Œæ“ä½œ
â€¢ æ•°æ®å½’æ¡£ï¼šè½»æ¾åˆ é™¤æ—§åˆ†åŒº
```

**ğŸ“Š åˆ†åŒºç±»å‹å¯¹æ¯”**

| åˆ†åŒºç±»å‹ | **åˆ†åŒºä¾æ®** | **é€‚ç”¨åœºæ™¯** | **æŸ¥è¯¢ä¼˜åŒ–** |
|---------|-------------|-------------|-------------|
| **RANGE** | `å€¼èŒƒå›´` | `æ—¶é—´åºåˆ—æ•°æ®` | `èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–` |
| **LIST** | `å€¼åˆ—è¡¨` | `åœ°åŒºã€çŠ¶æ€åˆ†ç±»` | `ç­‰å€¼æŸ¥è¯¢ä¼˜åŒ–` |
| **HASH** | `å“ˆå¸Œå‡½æ•°` | `å‡åŒ€åˆ†å¸ƒæ•°æ®` | `å¹¶è¡Œå¤„ç†ä¼˜åŒ–` |
| **KEY** | `MySQLå“ˆå¸Œ` | `ä¸»é”®åˆ†åŒº` | `è´Ÿè½½å‡è¡¡` |

### 5.2 RANGEåˆ†åŒºå®è·µ


**ğŸ—“ï¸ æŒ‰æ—¶é—´èŒƒå›´åˆ†åŒº**
```sql
-- è®¢å•è¡¨æŒ‰å¹´ä»½åˆ†åŒº
CREATE TABLE orders_partitioned (
    order_id INT AUTO_INCREMENT,
    customer_id INT,
    order_date DATE NOT NULL,
    amount DECIMAL(10,2),
    status VARCHAR(20),
    PRIMARY KEY (order_id, order_date),  -- åˆ†åŒºé”®å¿…é¡»åœ¨ä¸»é”®ä¸­
    KEY idx_customer (customer_id),
    KEY idx_status (status)
) ENGINE=InnoDB
PARTITION BY RANGE (YEAR(order_date)) (
    PARTITION p2022 VALUES LESS THAN (2023),
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- æŒ‰æœˆä»½æ›´ç»†ç²’åº¦åˆ†åŒº
CREATE TABLE user_activities (
    activity_id BIGINT AUTO_INCREMENT,
    user_id INT,
    activity_type VARCHAR(50),
    activity_time TIMESTAMP NOT NULL,
    details JSON,
    PRIMARY KEY (activity_id, activity_time)
) ENGINE=InnoDB
PARTITION BY RANGE (TO_DAYS(activity_time)) (
    PARTITION p202401 VALUES LESS THAN (TO_DAYS('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (TO_DAYS('2024-03-01')),
    PARTITION p202403 VALUES LESS THAN (TO_DAYS('2024-04-01')),
    PARTITION p202404 VALUES LESS THAN (TO_DAYS('2024-05-01')),
    PARTITION p_current VALUES LESS THAN MAXVALUE
);

-- åŠ¨æ€æ·»åŠ æ–°åˆ†åŒº
ALTER TABLE orders_partitioned 
ADD PARTITION (PARTITION p2026 VALUES LESS THAN (2027));

-- åˆ é™¤æ—§åˆ†åŒºï¼ˆå¿«é€Ÿåˆ é™¤å†å²æ•°æ®ï¼‰
ALTER TABLE orders_partitioned DROP PARTITION p2022;
```

### 5.3 LISTåˆ†åŒºåº”ç”¨


**ğŸŒ æŒ‰åœ°åŒº/çŠ¶æ€åˆ†åŒº**
```sql
-- ç”¨æˆ·è¡¨æŒ‰åœ°åŒºåˆ†åŒº
CREATE TABLE users_by_region (
    user_id INT AUTO_INCREMENT,
    username VARCHAR(50),
    email VARCHAR(100),
    region_code VARCHAR(10) NOT NULL,
    registration_date DATE,
    PRIMARY KEY (user_id, region_code)
) ENGINE=InnoDB
PARTITION BY LIST COLUMNS(region_code) (
    PARTITION p_north VALUES IN ('BJ', 'TJ', 'HB', 'SX', 'NM'),
    PARTITION p_east VALUES IN ('SH', 'JS', 'ZJ', 'AH', 'FJ', 'JX', 'SD'),
    PARTITION p_south VALUES IN ('GD', 'GX', 'HI', 'HN', 'HB'),
    PARTITION p_west VALUES IN ('CQ', 'SC', 'GZ', 'YN', 'XZ', 'SN', 'GS', 'QH', 'NX', 'XJ'),
    PARTITION p_other VALUES IN ('HK', 'MO', 'TW', 'OVERSEAS')
);

-- è®¢å•è¡¨æŒ‰çŠ¶æ€åˆ†åŒº
CREATE TABLE orders_by_status (
    order_id INT AUTO_INCREMENT,
    customer_id INT,
    status VARCHAR(20) NOT NULL,
    amount DECIMAL(10,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (order_id, status)
) ENGINE=InnoDB
PARTITION BY LIST COLUMNS(status) (
    PARTITION p_active VALUES IN ('pending', 'processing', 'confirmed'),
    PARTITION p_completed VALUES IN ('shipped', 'delivered', 'completed'),
    PARTITION p_cancelled VALUES IN ('cancelled', 'refunded', 'returned')
);
```

### 5.4 HASHåˆ†åŒºè´Ÿè½½å‡è¡¡


**âš–ï¸ å“ˆå¸Œåˆ†åŒºçš„å‡åŒ€åˆ†å¸ƒ**
```sql
-- ç”¨æˆ·è¡¨æŒ‰ç”¨æˆ·IDå“ˆå¸Œåˆ†åŒº
CREATE TABLE users_hash (
    user_id INT AUTO_INCREMENT,
    username VARCHAR(50),
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id)
) ENGINE=InnoDB
PARTITION BY HASH(user_id)
PARTITIONS 8;  -- 8ä¸ªåˆ†åŒº

-- ä¼šè¯è¡¨æŒ‰ä¼šè¯IDå“ˆå¸Œåˆ†åŒº
CREATE TABLE user_sessions_hash (
    session_id VARCHAR(128),
    user_id INT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,
    PRIMARY KEY (session_id)
) ENGINE=InnoDB
PARTITION BY KEY(session_id)  -- KEYåˆ†åŒºä½¿ç”¨MySQLå†…éƒ¨å“ˆå¸Œ
PARTITIONS 16;

-- æŸ¥çœ‹åˆ†åŒºæ•°æ®åˆ†å¸ƒ
SELECT 
    PARTITION_NAME,
    TABLE_ROWS,
    AVG_ROW_LENGTH,
    DATA_LENGTH
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'users_hash';
```

### 5.5 åˆ†åŒºè¡¨ç®¡ç†æ“ä½œ


**ğŸ”§ åˆ†åŒºç»´æŠ¤å‘½ä»¤**
```sql
-- æŸ¥çœ‹åˆ†åŒºä¿¡æ¯
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    PARTITION_NAME,
    PARTITION_ORDINAL_POSITION,
    PARTITION_METHOD,
    PARTITION_EXPRESSION,
    PARTITION_DESCRIPTION,
    TABLE_ROWS,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'SIZE_MB'
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders_partitioned'
ORDER BY PARTITION_ORDINAL_POSITION;

-- æ·»åŠ æ–°åˆ†åŒº
ALTER TABLE orders_partitioned 
ADD PARTITION (
    PARTITION p2027 VALUES LESS THAN (2028),
    PARTITION p2028 VALUES LESS THAN (2029)
);

-- åˆ é™¤åˆ†åŒº
ALTER TABLE orders_partitioned DROP PARTITION p2022;

-- é‡ç»„åˆ†åŒº
ALTER TABLE orders_partitioned 
REORGANIZE PARTITION p_future INTO (
    PARTITION p2026 VALUES LESS THAN (2027),
    PARTITION p2027 VALUES LESS THAN (2028),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- åˆ†åŒºè£å‰ªæŸ¥çœ‹
EXPLAIN PARTITIONS 
SELECT * FROM orders_partitioned 
WHERE order_date BETWEEN '2024-01-01' AND '2024-12-31';
```

---

## 6. ğŸ—œï¸ è¡¨çº§å‹ç¼©ä¸ä¼˜åŒ–


### 6.1 å‹ç¼©ç®—æ³•å¯¹æ¯”åˆ†æ


**ğŸ“Š å‹ç¼©æ€§èƒ½æµ‹è¯•**
```sql
-- åˆ›å»ºæµ‹è¯•è¡¨æ¯”è¾ƒä¸åŒå‹ç¼©è®¾ç½®
CREATE TABLE test_no_compress (
    id INT PRIMARY KEY,
    data1 VARCHAR(500),
    data2 TEXT,
    data3 JSON
) ENGINE=InnoDB;

CREATE TABLE test_compress_4k (
    id INT PRIMARY KEY,
    data1 VARCHAR(500),
    data2 TEXT,
    data3 JSON
) ENGINE=InnoDB ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=4;

CREATE TABLE test_compress_8k (
    id INT PRIMARY KEY,
    data1 VARCHAR(500),
    data2 TEXT,
    data3 JSON
) ENGINE=InnoDB ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;

-- æ’å…¥ç›¸åŒæµ‹è¯•æ•°æ®
INSERT INTO test_no_compress 
SELECT 
    seq,
    REPEAT(CHAR(65 + (seq % 26)), 200),
    REPEAT('æµ‹è¯•æ•°æ®å‹ç¼©æ•ˆæœ', 50),
    JSON_OBJECT('id', seq, 'data', REPEAT('test', 10))
FROM seq_1_to_50000;

-- å¤åˆ¶æ•°æ®åˆ°å‹ç¼©è¡¨
INSERT INTO test_compress_4k SELECT * FROM test_no_compress;
INSERT INTO test_compress_8k SELECT * FROM test_no_compress;

-- å¯¹æ¯”å‹ç¼©æ•ˆæœ
SELECT 
    TABLE_NAME,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'DATA_MB',
    ROUND(INDEX_LENGTH/1024/1024, 2) AS 'INDEX_MB',
    ROUND((DATA_LENGTH+INDEX_LENGTH)/1024/1024, 2) AS 'TOTAL_MB',
    ROW_FORMAT,
    CREATE_OPTIONS
FROM information_schema.TABLES 
WHERE TABLE_NAME LIKE 'test_%compress%'
ORDER BY DATA_LENGTH DESC;
```

### 6.2 å‹ç¼©æ€§èƒ½ç›‘æ§


**ğŸ“ˆ å‹ç¼©æ•ˆæœç›‘æ§**
```sql
-- åˆ›å»ºå‹ç¼©ç›‘æ§è§†å›¾
CREATE VIEW compression_stats AS
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    ROW_FORMAT,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'DATA_MB',
    ROUND(INDEX_LENGTH/1024/1024, 2) AS 'INDEX_MB',
    TABLE_ROWS,
    ROUND(DATA_LENGTH/TABLE_ROWS, 2) AS 'AVG_ROW_SIZE',
    CREATE_OPTIONS
FROM information_schema.TABLES 
WHERE ENGINE = 'InnoDB' 
AND ROW_FORMAT IN ('Compressed', 'Dynamic', 'Compact')
ORDER BY DATA_LENGTH DESC;

-- æŸ¥çœ‹å‹ç¼©çŠ¶æ€
SELECT * FROM compression_stats;

-- å‹ç¼©å¤±è´¥ç›‘æ§
SELECT 
    VARIABLE_NAME,
    VARIABLE_VALUE,
    CASE 
        WHEN VARIABLE_NAME = 'Innodb_num_pages_compressed' 
        THEN 'å‹ç¼©é¡µé¢æ•°'
        WHEN VARIABLE_NAME = 'Innodb_num_pages_decompressed'
        THEN 'è§£å‹é¡µé¢æ•°'
        WHEN VARIABLE_NAME = 'Innodb_compress_time'
        THEN 'å‹ç¼©è€—æ—¶(ms)'
        WHEN VARIABLE_NAME = 'Innodb_uncompress_time'
        THEN 'è§£å‹è€—æ—¶(ms)'
    END AS 'è¯´æ˜'
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME LIKE '%compress%';
```

---

## 7. ğŸ“‹ è¡¨ç›‘æ§ä¸å®¡è®¡


### 7.1 è¡¨çº§å®¡è®¡é…ç½®


**ğŸ”¸ å®¡è®¡çš„é‡è¦æ€§**
```
è¡¨çº§å®¡è®¡ç”¨é€”ï¼š
â€¢ æ•æ„Ÿæ•°æ®è®¿é—®è®°å½•
â€¢ æ•°æ®å˜æ›´è¿½è¸ª
â€¢ åˆè§„æ€§è¦æ±‚æ»¡è¶³
â€¢ å®‰å…¨äº‹ä»¶è°ƒæŸ¥

MySQLå®¡è®¡æ–¹å¼ï¼š
â€¢ MySQL Enterprise Auditï¼šå•†ä¸šç‰ˆåŠŸèƒ½
â€¢ é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰SQLè¯­å¥
â€¢ äºŒè¿›åˆ¶æ—¥å¿—ï¼šè®°å½•æ•°æ®å˜æ›´
â€¢ è‡ªå®šä¹‰å®¡è®¡è¡¨ï¼šåº”ç”¨å±‚å®ç°
```

**ğŸ”§ è‡ªå®šä¹‰å®¡è®¡è¡¨å®ç°**
```sql
-- åˆ›å»ºå®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE audit_logs (
    audit_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    table_name VARCHAR(64),
    operation_type ENUM('SELECT', 'INSERT', 'UPDATE', 'DELETE'),
    user_name VARCHAR(32),
    connection_id INT,
    query_text TEXT,
    affected_rows INT,
    execution_time DECIMAL(10,3),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    KEY idx_table_time (table_name, created_at),
    KEY idx_user_time (user_name, created_at)
) ENGINE=InnoDB
  ROW_FORMAT=COMPRESSED;

-- åˆ›å»ºå®¡è®¡è§¦å‘å™¨ç¤ºä¾‹
DELIMITER $$

-- ç”¨æˆ·è¡¨æ›´æ–°å®¡è®¡
CREATE TRIGGER user_update_audit 
AFTER UPDATE ON users 
FOR EACH ROW
BEGIN
    INSERT INTO audit_logs (
        table_name, 
        operation_type, 
        user_name, 
        connection_id,
        query_text,
        affected_rows
    ) VALUES (
        'users',
        'UPDATE',
        USER(),
        CONNECTION_ID(),
        'User data updated',
        ROW_COUNT()
    );
END$$

-- æ•æ„Ÿè¡¨åˆ é™¤å®¡è®¡
CREATE TRIGGER sensitive_delete_audit
BEFORE DELETE ON sensitive_data
FOR EACH ROW  
BEGIN
    INSERT INTO audit_logs (
        table_name,
        operation_type,
        user_name,
        connection_id,
        query_text
    ) VALUES (
        'sensitive_data',
        'DELETE', 
        USER(),
        CONNECTION_ID(),
        CONCAT('Deleted record ID: ', OLD.id)
    );
END$$

DELIMITER ;
```

### 7.2 è¡¨çº§ç›‘æ§é…ç½®


**ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```sql
-- åˆ›å»ºè¡¨æ€§èƒ½ç›‘æ§è§†å›¾
CREATE VIEW table_performance_stats AS
SELECT 
    t.TABLE_SCHEMA,
    t.TABLE_NAME,
    t.TABLE_ROWS,
    ROUND(t.DATA_LENGTH/1024/1024, 2) AS 'DATA_MB',
    ROUND(t.INDEX_LENGTH/1024/1024, 2) AS 'INDEX_MB',
    t.AUTO_INCREMENT,
    
    -- è¡¨è®¿é—®ç»Ÿè®¡
    s.COUNT_READ,
    s.COUNT_WRITE,
    s.COUNT_INSERT,
    s.COUNT_UPDATE,
    s.COUNT_DELETE,
    
    -- è¡¨é”ç»Ÿè®¡
    s.SUM_TIMER_READ/1000000000 AS 'READ_time_sec',
    s.SUM_TIMER_WRITE/1000000000 AS 'write_time_sec'
    
FROM information_schema.TABLES t
LEFT JOIN performance_schema.table_io_waits_summary_by_table s
    ON t.TABLE_SCHEMA = s.OBJECT_SCHEMA 
    AND t.TABLE_NAME = s.OBJECT_NAME
WHERE t.TABLE_SCHEMA NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys')
ORDER BY (t.DATA_LENGTH + t.INDEX_LENGTH) DESC;

-- æŸ¥çœ‹è¡¨æ€§èƒ½ç»Ÿè®¡
SELECT * FROM table_performance_stats LIMIT 10;

-- è¡¨ç©ºé—´ä½¿ç”¨ç›‘æ§
SELECT 
    TABLE_NAME,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'DATA_MB',
    ROUND(INDEX_LENGTH/1024/1024, 2) AS 'INDEX_MB',
    ROUND(DATA_FREE/1024/1024, 2) AS 'FREE_MB',
    ROUND((DATA_LENGTH-DATA_FREE)/DATA_LENGTH*100, 2) AS 'USAGE_%'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = DATABASE()
AND DATA_LENGTH > 0
ORDER BY DATA_LENGTH DESC;
```

**âš¡ å®æ—¶ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# table-monitor.sh - è¡¨çº§ç›‘æ§è„šæœ¬

DB_HOST="localhost"
DB_USER="monitor_user"
DB_PASS="monitor_password"
DB_NAME="myapp"

# ç›‘æ§å‡½æ•°
monitor_table_size() {
    echo "=== è¡¨å¤§å°ç›‘æ§ ==="
    mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME -e "
    SELECT 
        TABLE_NAME as 'è¡¨å',
        ROUND(DATA_LENGTH/1024/1024, 2) AS 'æ•°æ®å¤§å°MB',
        ROUND(INDEX_LENGTH/1024/1024, 2) AS 'ç´¢å¼•å¤§å°MB',
        TABLE_ROWS as 'è¡Œæ•°'
    FROM information_schema.TABLES 
    WHERE TABLE_SCHEMA = '$DB_NAME'
    AND ENGINE = 'InnoDB'
    ORDER BY (DATA_LENGTH+INDEX_LENGTH) DESC
    LIMIT 10;"
}

monitor_table_activity() {
    echo "=== è¡¨æ´»åŠ¨ç›‘æ§ ==="
    mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME -e "
    SELECT 
        OBJECT_NAME as 'è¡¨å',
        COUNT_READ as 'è¯»æ¬¡æ•°',
        COUNT_WRITE as 'å†™æ¬¡æ•°',
        COUNT_INSERT as 'æ’å…¥æ¬¡æ•°',
        COUNT_UPDATE as 'æ›´æ–°æ¬¡æ•°',
        COUNT_DELETE as 'åˆ é™¤æ¬¡æ•°'
    FROM performance_schema.table_io_waits_summary_by_table
    WHERE OBJECT_SCHEMA = '$DB_NAME'
    AND (COUNT_READ + COUNT_WRITE) > 0
    ORDER BY (COUNT_READ + COUNT_WRITE) DESC
    LIMIT 10;"
}

monitor_slow_queries() {
    echo "=== æ…¢æŸ¥è¯¢ç›‘æ§ ==="
    mysql -h$DB_HOST -u$DB_USER -p$DB_PASS -e "
    SELECT 
        DIGEST_TEXT as 'æŸ¥è¯¢è¯­å¥',
        COUNT_STAR as 'æ‰§è¡Œæ¬¡æ•°',
        ROUND(AVG_TIMER_WAIT/1000000000, 3) as 'å¹³å‡è€—æ—¶ç§’',
        ROUND(MAX_TIMER_WAIT/1000000000, 3) as 'æœ€å¤§è€—æ—¶ç§’'
    FROM performance_schema.events_statements_summary_by_digest
    WHERE DIGEST_TEXT IS NOT NULL
    AND AVG_TIMER_WAIT > 1000000000  -- è¶…è¿‡1ç§’çš„æŸ¥è¯¢
    ORDER BY AVG_TIMER_WAIT DESC
    LIMIT 10;"
}

# æ‰§è¡Œç›‘æ§
echo "MySQLè¡¨çº§ç›‘æ§æŠ¥å‘Š - $(date)"
echo "=========================================="
monitor_table_size
echo
monitor_table_activity  
echo
monitor_slow_queries
echo "=========================================="
```

### 7.3 å‘Šè­¦é˜ˆå€¼é…ç½®


**ğŸš¨ è¡¨çº§å‘Šè­¦è§„åˆ™**
```sql
-- åˆ›å»ºç›‘æ§é˜ˆå€¼é…ç½®è¡¨
CREATE TABLE monitoring_thresholds (
    id INT AUTO_INCREMENT PRIMARY KEY,
    table_name VARCHAR(64),
    metric_name VARCHAR(50),
    threshold_value DECIMAL(15,2),
    alert_level ENUM('INFO', 'WARNING', 'CRITICAL'),
    enabled TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ’å…¥ç›‘æ§é˜ˆå€¼
INSERT INTO monitoring_thresholds 
(table_name, metric_name, threshold_value, alert_level) VALUES
('users', 'table_size_mb', 1000, 'WARNING'),
('users', 'table_size_mb', 2000, 'CRITICAL'),
('orders', 'growth_rate_daily', 50000, 'WARNING'),
('user_sessions', 'table_rows', 1000000, 'WARNING'),
('audit_logs', 'table_size_mb', 5000, 'CRITICAL');

-- ç›‘æ§æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹
DELIMITER $$

CREATE PROCEDURE CheckTableAlerts()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE table_name_var VARCHAR(64);
    DECLARE current_size DECIMAL(15,2);
    DECLARE threshold_size DECIMAL(15,2);
    DECLARE alert_level_var VARCHAR(20);
    
    -- æ¸¸æ ‡å®šä¹‰
    DECLARE size_cursor CURSOR FOR
        SELECT 
            t.TABLE_NAME,
            ROUND((t.DATA_LENGTH + t.INDEX_LENGTH)/1024/1024, 2),
            mt.threshold_value,
            mt.alert_level
        FROM information_schema.TABLES t
        JOIN monitoring_thresholds mt ON t.TABLE_NAME = mt.table_name
        WHERE t.TABLE_SCHEMA = DATABASE()
        AND mt.metric_name = 'table_size_mb'
        AND mt.enabled = 1;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    -- åˆ›å»ºä¸´æ—¶å‘Šè­¦è¡¨
    DROP TEMPORARY TABLE IF EXISTS temp_alerts;
    CREATE TEMPORARY TABLE temp_alerts (
        table_name VARCHAR(64),
        current_value DECIMAL(15,2),
        threshold_value DECIMAL(15,2),
        alert_level VARCHAR(20),
        message TEXT
    );
    
    OPEN size_cursor;
    
    read_loop: LOOP
        FETCH size_cursor INTO table_name_var, current_size, threshold_size, alert_level_var;
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼
        IF current_size > threshold_size THEN
            INSERT INTO temp_alerts VALUES (
                table_name_var,
                current_size,
                threshold_size,
                alert_level_var,
                CONCAT('è¡¨ ', table_name_var, ' å¤§å° ', current_size, 'MB è¶…è¿‡é˜ˆå€¼ ', threshold_size, 'MB')
            );
        END IF;
        
    END LOOP;
    
    CLOSE size_cursor;
    
    -- è¿”å›å‘Šè­¦ç»“æœ
    SELECT * FROM temp_alerts;
    
END$$

DELIMITER ;

-- æ‰§è¡Œå‘Šè­¦æ£€æŸ¥
CALL CheckTableAlerts();
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ ç‰¹æ®Šè¡¨å¼•æ“çš„é€‚ç”¨åœºæ™¯**
```
MERGE/UNIONè¡¨ï¼š
â€¢ ç”¨é€”ï¼šåˆå¹¶å¤šä¸ªç›¸åŒç»“æ„çš„MyISAMè¡¨
â€¢ åœºæ™¯ï¼šå†å²æ•°æ®å½’æ¡£ã€æ—¥å¿—æ•°æ®åˆå¹¶
â€¢ é™åˆ¶ï¼šåªæ”¯æŒMyISAMå¼•æ“

CSVè¡¨ï¼š
â€¢ ç”¨é€”ï¼šä¸å¤–éƒ¨ç³»ç»Ÿæ•°æ®äº¤æ¢
â€¢ åœºæ™¯ï¼šæ•°æ®å¯¼å…¥å¯¼å‡ºã€æ—¥å¿—å­˜å‚¨
â€¢ é™åˆ¶ï¼šä¸æ”¯æŒç´¢å¼•ã€äº‹åŠ¡

FEDERATEDè¡¨ï¼š
â€¢ ç”¨é€”ï¼šè®¿é—®è¿œç¨‹MySQLæœåŠ¡å™¨çš„è¡¨
â€¢ åœºæ™¯ï¼šåˆ†å¸ƒå¼æ•°æ®åº“ã€è·¨æ•°æ®ä¸­å¿ƒè®¿é—®
â€¢ é™åˆ¶ï¼šç½‘ç»œä¾èµ–ã€æ€§èƒ½å—é™
```

**ğŸ”¸ è¡¨ç©ºé—´å’Œå­˜å‚¨æ ¼å¼çš„æ ¸å¿ƒç†è§£**
```
è¡¨ç©ºé—´ç®¡ç†ï¼š
â€¢ ç³»ç»Ÿè¡¨ç©ºé—´ï¼šé»˜è®¤å­˜å‚¨ä½ç½®
â€¢ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šæ¯è¡¨ä¸€ä¸ªæ–‡ä»¶
â€¢ é€šç”¨è¡¨ç©ºé—´ï¼šè‡ªå®šä¹‰å…±äº«ç©ºé—´

è¡Œæ ¼å¼é€‰æ‹©ï¼š
â€¢ COMPACTï¼šé»˜è®¤æ ¼å¼ï¼Œé€‚åˆä¸€èˆ¬åœºæ™¯
â€¢ DYNAMICï¼šå¤§å­—æ®µåœºæ™¯
â€¢ COMPRESSEDï¼šç©ºé—´ç´§å¼ åœºæ™¯
â€¢ REDUNDANTï¼šå…¼å®¹æ€§åœºæ™¯
```

**ğŸ”¸ åˆ†åŒºè¡¨çš„è®¾è®¡åŸåˆ™**
```
åˆ†åŒºé€‰æ‹©ï¼š
â€¢ RANGEï¼šæ—¶é—´åºåˆ—æ•°æ®é¦–é€‰
â€¢ LISTï¼šåˆ†ç±»æ•°æ®çš„æ˜ç¡®åˆ’åˆ†
â€¢ HASHï¼šæ•°æ®å‡åŒ€åˆ†å¸ƒ
â€¢ KEYï¼šåŸºäºä¸»é”®çš„è‡ªåŠ¨åˆ†åŒº

åˆ†åŒºé”®è¦æ±‚ï¼š
â€¢ å¿…é¡»åŒ…å«åœ¨ä¸»é”®æˆ–å”¯ä¸€é”®ä¸­
â€¢ é€‰æ‹©æŸ¥è¯¢ä¸­ç»å¸¸ä½¿ç”¨çš„åˆ—
â€¢ åˆ†åŒºæ•°é‡é€‚ä¸­ï¼ˆå»ºè®®ä¸è¶…è¿‡100ä¸ªï¼‰
```

### 8.2 å…³é”®å®è·µè¦ç‚¹


**ğŸ”¹ åŠ å¯†è¡¨çš„ä½¿ç”¨ç­–ç•¥**
```
ä»€ä¹ˆæ—¶å€™ç”¨åŠ å¯†ï¼š
â€¢ å­˜å‚¨ä¸ªäººéšç§ä¿¡æ¯ï¼ˆèº«ä»½è¯ã€é“¶è¡Œå¡ï¼‰
â€¢ è´¢åŠ¡æ•æ„Ÿæ•°æ®ï¼ˆå·¥èµ„ã€äº¤æ˜“é‡‘é¢ï¼‰
â€¢ å•†ä¸šæœºå¯†ä¿¡æ¯ï¼ˆå®¢æˆ·åå•ã€å®šä»·ç­–ç•¥ï¼‰

åŠ å¯†çš„æ€§èƒ½å½±å“ï¼š
â€¢ CPUå¼€é”€ï¼š5-15%çš„é¢å¤–CPUä½¿ç”¨
â€¢ å­˜å‚¨å¼€é”€ï¼šå‡ ä¹æ— é¢å¤–å­˜å‚¨ç©ºé—´
â€¢ å†…å­˜å¼€é”€ï¼šåŠ å¯†é¡µé¢å ç”¨ç¼“å†²æ± 

å¯†é’¥ç®¡ç†ï¼š
â€¢ æœ¬åœ°å¯†é’¥ï¼šé€‚åˆæµ‹è¯•ç¯å¢ƒ
â€¢ ä¼ä¸šå¯†é’¥ç®¡ç†ï¼šç”Ÿäº§ç¯å¢ƒæ¨è
â€¢ å®šæœŸè½®æ¢ï¼šå¢å¼ºå®‰å…¨æ€§
```

**ğŸ”¹ å‹ç¼©è¡¨çš„ä½¿ç”¨æŠ€å·§**
```
å‹ç¼©å†³ç­–ï¼š
â€¢ æ•°æ®ç‰¹ç‚¹ï¼šé‡å¤æ•°æ®å¤šçš„è¡¨å‹ç¼©æ•ˆæœå¥½
â€¢ è®¿é—®æ¨¡å¼ï¼šè¯»å¤šå†™å°‘çš„è¡¨é€‚åˆå‹ç¼©
â€¢ å­˜å‚¨æˆæœ¬ï¼šå­˜å‚¨ç©ºé—´æ˜‚è´µæ—¶ä¼˜å…ˆè€ƒè™‘

å‹ç¼©å—å¤§å°é€‰æ‹©ï¼š
â€¢ 1-2KBï¼šå°è®°å½•ï¼Œé«˜å‹ç¼©ç‡
â€¢ 4-8KBï¼šä¸­ç­‰è®°å½•ï¼Œå¹³è¡¡é€‰æ‹©
â€¢ 16KBï¼šå¤§è®°å½•ï¼Œä½å‹ç¼©å¼€é”€

ç›‘æ§è¦ç‚¹ï¼š
â€¢ å‹ç¼©ç‡ï¼šDATA_LENGTHçš„å‹ç¼©æ•ˆæœ
â€¢ æ€§èƒ½å½±å“ï¼šæŸ¥è¯¢å“åº”æ—¶é—´å˜åŒ–
â€¢ èµ„æºä½¿ç”¨ï¼šCPUå‹ç¼©è§£å‹å¼€é”€
```

**ğŸ”¹ åˆ†åŒºè¡¨çš„ç»´æŠ¤ç­–ç•¥**
```
åˆ†åŒºç»´æŠ¤ï¼š
â€¢ å®šæœŸæ·»åŠ æ–°åˆ†åŒºï¼ˆå¦‚æŒ‰æœˆåˆ†åŒºçš„è¡¨ï¼‰
â€¢ åŠæ—¶åˆ é™¤æ—§åˆ†åŒºï¼ˆé‡Šæ”¾å­˜å‚¨ç©ºé—´ï¼‰
â€¢ ç›‘æ§åˆ†åŒºæ•°æ®åˆ†å¸ƒï¼ˆé¿å…æ•°æ®å€¾æ–œï¼‰

æŸ¥è¯¢ä¼˜åŒ–ï¼š
â€¢ åˆ†åŒºè£å‰ªï¼šæŸ¥è¯¢æ¡ä»¶åŒ…å«åˆ†åŒºé”®
â€¢ ç´¢å¼•è®¾è®¡ï¼šæ¯ä¸ªåˆ†åŒºç‹¬ç«‹çš„ç´¢å¼•
â€¢ ç»Ÿè®¡ä¿¡æ¯ï¼šå®šæœŸæ›´æ–°åˆ†åŒºç»Ÿè®¡ä¿¡æ¯

è¿ç»´æ³¨æ„ï¼š
â€¢ å¤‡ä»½ï¼šå¯ä»¥æŒ‰åˆ†åŒºå¤‡ä»½
â€¢ æ¢å¤ï¼šå¯ä»¥æ¢å¤ç‰¹å®šåˆ†åŒº
â€¢ ç›‘æ§ï¼šåˆ†åŒºçº§åˆ«çš„æ€§èƒ½ç›‘æ§
```

### 8.3 ç”Ÿäº§ç¯å¢ƒåº”ç”¨æŒ‡å—


**â­ é«˜çº§é€‰é¡¹ä½¿ç”¨å†³ç­–æµç¨‹**
```
è¡¨è®¾è®¡å†³ç­–æµç¨‹ï¼š
æ•°æ®æ•æ„Ÿæ€§è¯„ä¼°
    â†“
æ•æ„Ÿæ•°æ®? â†’ æ˜¯ â†’ å¯ç”¨è¡¨åŠ å¯† + å®¡è®¡æ—¥å¿—
    â†“
    å¦
    â†“
æ•°æ®é‡è¯„ä¼°
    â†“
å¤§æ•°æ®é‡? â†’ æ˜¯ â†’ è€ƒè™‘åˆ†åŒºè¡¨
    â†“                â†“
    å¦              æŒ‰ä»€ä¹ˆåˆ†åŒº?
    â†“                â†“
å­˜å‚¨ç©ºé—´ç´§å¼ ? â†’ æ˜¯ â†’ æ—¶é—´ â†’ RANGEåˆ†åŒº
    â†“                â†“
    å¦              åœ°åŒº/çŠ¶æ€ â†’ LISTåˆ†åŒº
    â†“                â†“
ç‰¹æ®Šéœ€æ±‚è¯„ä¼°        å‡åŒ€åˆ†å¸ƒ â†’ HASHåˆ†åŒº
    â†“
è·¨æ•°æ®åº“è®¿é—®? â†’ æ˜¯ â†’ FEDERATEDè¡¨
    â†“
æ•°æ®å¯¼å…¥å¯¼å‡º? â†’ æ˜¯ â†’ CSVè¡¨
    â†“
å†å²æ•°æ®åˆå¹¶? â†’ æ˜¯ â†’ MERGEè¡¨
    â†“
ä½¿ç”¨é»˜è®¤InnoDBè¡¨
```

**ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿**
```sql
-- ç”¨æˆ·æ•æ„Ÿä¿¡æ¯è¡¨
CREATE TABLE user_private_info (
    user_id INT PRIMARY KEY,
    real_name VARCHAR(50),
    id_number VARCHAR(20),
    phone VARCHAR(20),
    bank_account VARCHAR(30),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci
  ROW_FORMAT=DYNAMIC
  ENCRYPTION='Y'           -- å¼€å¯åŠ å¯†
  TABLESPACE=secure_space; -- ä½¿ç”¨å®‰å…¨è¡¨ç©ºé—´

-- è®¢å•å†å²è¡¨ï¼ˆåˆ†åŒº+å‹ç¼©ï¼‰
CREATE TABLE order_history (
    order_id BIGINT AUTO_INCREMENT,
    customer_id INT,
    order_date DATE NOT NULL,
    total_amount DECIMAL(12,2),
    order_status VARCHAR(20),
    order_details JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (order_id, order_date),
    KEY idx_customer_date (customer_id, order_date),
    KEY idx_status (order_status)
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci  
  ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=8
  PARTITION BY RANGE (YEAR(order_date)) (
      PARTITION p2022 VALUES LESS THAN (2023),
      PARTITION p2023 VALUES LESS THAN (2024),
      PARTITION p2024 VALUES LESS THAN (2025),
      PARTITION p2025 VALUES LESS THAN (2026),
      PARTITION p_future VALUES LESS THAN MAXVALUE
  );

-- æ—¥å¿—æ•°æ®è¡¨ï¼ˆCSVå¼•æ“ï¼‰
CREATE TABLE system_logs_csv (
    log_id BIGINT NOT NULL,
    log_time VARCHAR(19),
    log_level VARCHAR(10),
    log_message TEXT,
    source_ip VARCHAR(45),
    PRIMARY KEY (log_id)
) ENGINE=CSV;
```

### 8.4 æ•…éšœæ’æŸ¥ä¸æ€§èƒ½ä¼˜åŒ–


**ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥**
```sql
-- æ£€æŸ¥è¡¨å¼•æ“å’Œé€‰é¡¹
SELECT 
    TABLE_NAME,
    ENGINE,
    ROW_FORMAT,
    CREATE_OPTIONS
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = DATABASE();

-- æ£€æŸ¥åˆ†åŒºè¡¨çŠ¶æ€
SELECT 
    TABLE_NAME,
    PARTITION_NAME,
    PARTITION_METHOD,
    PARTITION_EXPRESSION,
    TABLE_ROWS,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'SIZE_MB'
FROM information_schema.PARTITIONS 
WHERE TABLE_SCHEMA = DATABASE()
AND PARTITION_NAME IS NOT NULL;

-- æ£€æŸ¥åŠ å¯†è¡¨çŠ¶æ€
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    CREATE_OPTIONS
FROM information_schema.TABLES 
WHERE CREATE_OPTIONS LIKE '%ENCRYPTION%';

-- æ£€æŸ¥è¡¨ç©ºé—´ä½¿ç”¨
SELECT 
    TABLESPACE_NAME,
    FILE_NAME,
    ROUND(FILE_SIZE/1024/1024, 2) AS 'SIZE_MB',
    AUTOEXTEND_SIZE,
    MAX_SIZE
FROM information_schema.FILES 
WHERE TABLESPACE_NAME NOT LIKE 'innodb_%';
```

**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```sql
-- 1. åˆ†åŒºè£å‰ªæ•ˆæœæ£€æŸ¥
EXPLAIN PARTITIONS
SELECT * FROM order_history 
WHERE order_date BETWEEN '2024-01-01' AND '2024-12-31';

-- 2. å‹ç¼©æ•ˆæœè¯„ä¼°
SELECT 
    TABLE_NAME,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'CURRENT_MB',
    ROUND(DATA_LENGTH * 0.3, 2) AS 'ESTIMATED_COMPRESSED_MB',
    ROUND((1 - 0.3) * 100, 2) AS 'POTENTIAL_SAVINGS_%'
FROM information_schema.TABLES 
WHERE ROW_FORMAT != 'Compressed' 
AND DATA_LENGTH > 100*1024*1024;  -- å¤§äº100MBçš„è¡¨

-- 3. è¡¨ç¢ç‰‡æ£€æŸ¥
SELECT 
    TABLE_NAME,
    ROUND(DATA_FREE/1024/1024, 2) AS 'FRAGMENTATION_MB',
    ROUND(DATA_FREE/DATA_LENGTH*100, 2) AS 'FRAGMENTATION_%'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = DATABASE()
AND DATA_FREE > 0
ORDER BY DATA_FREE DESC;

-- 4. ä¼˜åŒ–å»ºè®®æŸ¥è¯¢
SELECT 
    TABLE_NAME,
    CASE 
        WHEN DATA_FREE/DATA_LENGTH > 0.2 THEN 'OPTIMIZE TABLEå»ºè®®'
        WHEN ROW_FORMAT != 'Compressed' AND DATA_LENGTH > 500*1024*1024 THEN 'è€ƒè™‘å¯ç”¨å‹ç¼©'
        WHEN TABLE_ROWS > 10000000 AND PARTITION_NAME IS NULL THEN 'è€ƒè™‘åˆ†åŒºè¡¨'
        ELSE 'è¡¨çŠ¶æ€æ­£å¸¸'
    END AS 'ä¼˜åŒ–å»ºè®®'
FROM information_schema.TABLES t
LEFT JOIN information_schema.PARTITIONS p ON t.TABLE_NAME = p.TABLE_NAME
WHERE t.TABLE_SCHEMA = DATABASE()
AND t.ENGINE = 'InnoDB'
ORDER BY t.DATA_LENGTH DESC;
```

### 8.5 é«˜çº§è¡¨é€‰é¡¹å®æˆ˜æ¡ˆä¾‹


**ğŸ¢ ä¼ä¸šçº§åº”ç”¨åœºæ™¯**
```sql
-- æ¡ˆä¾‹1ï¼šç”µå•†å¹³å°ç”¨æˆ·è¡¨è®¾è®¡
CREATE TABLE ecommerce_users (
    user_id INT AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255),
    real_name VARCHAR(50),
    id_card VARCHAR(20),           -- æ•æ„Ÿä¿¡æ¯
    phone VARCHAR(20),
    address TEXT,
    registration_date DATE NOT NULL,
    last_login_time TIMESTAMP,
    user_status ENUM('active', 'suspended', 'deleted') DEFAULT 'active',
    
    PRIMARY KEY (user_id, registration_date),
    UNIQUE KEY uk_username (username),
    UNIQUE KEY uk_email (email),
    KEY idx_status_date (user_status, registration_date)
    
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci
  ROW_FORMAT=DYNAMIC           -- æ”¯æŒå¤§å­—æ®µ
  ENCRYPTION='Y'               -- åŠ å¯†æ•æ„Ÿä¿¡æ¯
  TABLESPACE=user_secure_space -- ä¸“ç”¨å®‰å…¨è¡¨ç©ºé—´
  
  -- æŒ‰æ³¨å†Œå¹´ä»½åˆ†åŒº
  PARTITION BY RANGE (YEAR(registration_date)) (
      PARTITION p2022 VALUES LESS THAN (2023),
      PARTITION p2023 VALUES LESS THAN (2024), 
      PARTITION p2024 VALUES LESS THAN (2025),
      PARTITION p2025 VALUES LESS THAN (2026),
      PARTITION p_future VALUES LESS THAN MAXVALUE
  );

-- æ¡ˆä¾‹2ï¼šæ—¥å¿—åˆ†æç³»ç»Ÿ
-- åŸå§‹æ—¥å¿—è¡¨ï¼ˆCSVå¼•æ“ä¾¿äºå¤–éƒ¨å·¥å…·å¤„ç†ï¼‰
CREATE TABLE raw_access_logs (
    log_id BIGINT NOT NULL,
    timestamp_str VARCHAR(25),
    ip_address VARCHAR(45),
    http_method VARCHAR(10),
    url_path TEXT,
    http_status VARCHAR(3),
    response_size VARCHAR(20),
    user_agent TEXT,
    referer TEXT,
    PRIMARY KEY (log_id)
) ENGINE=CSV;

-- å¤„ç†åçš„æ—¥å¿—è¡¨ï¼ˆåˆ†åŒº+å‹ç¼©ï¼‰
CREATE TABLE processed_access_logs (
    log_id BIGINT AUTO_INCREMENT,
    log_date DATE NOT NULL,
    hour TINYINT,
    ip_address VARCHAR(45),
    http_method VARCHAR(10),
    url_path VARCHAR(500),
    http_status SMALLINT,
    response_size INT,
    user_agent_hash VARCHAR(32),
    country_code VARCHAR(2),
    
    PRIMARY KEY (log_id, log_date),
    KEY idx_date_hour (log_date, hour),
    KEY idx_ip_date (ip_address, log_date),
    KEY idx_status_date (http_status, log_date)
    
) ENGINE=InnoDB
  ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=8
  
  PARTITION BY RANGE (TO_DAYS(log_date)) (
      PARTITION p_202401 VALUES LESS THAN (TO_DAYS('2024-02-01')),
      PARTITION p_202402 VALUES LESS THAN (TO_DAYS('2024-03-01')),
      PARTITION p_202403 VALUES LESS THAN (TO_DAYS('2024-04-01')),
      PARTITION p_current VALUES LESS THAN MAXVALUE
  );

-- æ¡ˆä¾‹3ï¼šå¤šæ•°æ®ä¸­å¿ƒæ¶æ„
-- æœ¬åœ°ç¼“å­˜è¡¨
CREATE TABLE local_product_cache (
    product_id INT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2),
    stock_quantity INT,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB
  ROW_FORMAT=COMPRESSED;

-- è¿œç¨‹äº§å“ä¸»è¡¨çš„æœ¬åœ°ä»£ç†
CREATE TABLE remote_products (
    product_id INT,
    name VARCHAR(100),
    price DECIMAL(10,2),
    stock_quantity INT,
    last_updated TIMESTAMP
) ENGINE=FEDERATED
  CONNECTION='mysql://readonly_user:password@product-db.company.com:3306/inventory/products';

-- å†å²å¹´ä»½æ•°æ®åˆå¹¶è¡¨
CREATE TABLE sales_history_all (
    sale_id BIGINT,
    product_id INT,
    customer_id INT,
    sale_date DATE,
    amount DECIMAL(10,2),
    KEY idx_date (sale_date),
    KEY idx_product (product_id)
) ENGINE=MERGE
  UNION=(sales_2021, sales_2022, sales_2023)
  INSERT_METHOD=NO;  -- åªè¯»å†å²æ•°æ®
```

### 8.6 ç›‘æ§å’Œç»´æŠ¤è‡ªåŠ¨åŒ–


**ğŸ¤– è‡ªåŠ¨åŒ–ç»´æŠ¤è„šæœ¬**
```bash
#!/bin/bash
# advanced-table-maintenance.sh - é«˜çº§è¡¨ç»´æŠ¤è„šæœ¬

DB_HOST="localhost"
DB_USER="dba_user"
DB_PASS="dba_password"  
DB_NAME="production_db"

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log_info() {
    echo -e "${GREEN}[INFO]${NC} $(date '+%Y-%m-%d %H:%M:%S') $1"
}

log_warn() {
    echo -e "${YELLOW}[WARN]${NC} $(date '+%Y-%m-%d %H:%M:%S') $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $(date '+%Y-%m-%d %H:%M:%S') $1"
}

# 1. åˆ†åŒºè¡¨ç»´æŠ¤
maintain_partitions() {
    log_info "å¼€å§‹åˆ†åŒºè¡¨ç»´æŠ¤..."
    
    # è·å–éœ€è¦ç»´æŠ¤çš„åˆ†åŒºè¡¨
    PARTITION_TABLES=$(mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME -s -N -e "
        SELECT DISTINCT TABLE_NAME 
        FROM information_schema.PARTITIONS 
        WHERE TABLE_SCHEMA = '$DB_NAME' 
        AND PARTITION_NAME IS NOT NULL;"
    )
    
    for table in $PARTITION_TABLES; do
        log_info "ç»´æŠ¤åˆ†åŒºè¡¨: $table"
        
        # æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ æ–°åˆ†åŒº
        NEEDS_NEW_PARTITION=$(mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME -s -N -e "
            SELECT COUNT(*) FROM information_schema.PARTITIONS 
            WHERE TABLE_SCHEMA = '$DB_NAME' 
            AND TABLE_NAME = '$table'
            AND PARTITION_DESCRIPTION = 'MAXVALUE';"
        )
        
        if [ "$NEEDS_NEW_PARTITION" -eq 0 ]; then
            log_warn "è¡¨ $table å¯èƒ½éœ€è¦æ·»åŠ æ–°åˆ†åŒº"
        fi
        
        # åˆ é™¤ç©ºçš„æ—§åˆ†åŒºï¼ˆè¿™é‡Œéœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡é€»è¾‘è°ƒæ•´ï¼‰
        EMPTY_PARTITIONS=$(mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME -s -N -e "
            SELECT PARTITION_NAME 
            FROM information_schema.PARTITIONS 
            WHERE TABLE_SCHEMA = '$DB_NAME' 
            AND TABLE_NAME = '$table'
            AND TABLE_ROWS = 0
            AND PARTITION_DESCRIPTION != 'MAXVALUE';"
        )
        
        for partition in $EMPTY_PARTITIONS; do
            log_info "å‘ç°ç©ºåˆ†åŒº: $table.$partition"
            # è¿™é‡Œå¯ä»¥æ·»åŠ åˆ é™¤é€»è¾‘ï¼Œä½†è¦è°¨æ…
        done
    done
}

# 2. å‹ç¼©è¡¨æ•ˆæœæ£€æŸ¥
check_compression() {
    log_info "æ£€æŸ¥è¡¨å‹ç¼©æ•ˆæœ..."
    
    mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME -e "
    SELECT 
        TABLE_NAME as 'è¡¨å',
        ROW_FORMAT as 'è¡Œæ ¼å¼',
        ROUND(DATA_LENGTH/1024/1024, 2) AS 'æ•°æ®å¤§å°MB',
        TABLE_ROWS as 'è¡Œæ•°',
        ROUND(DATA_LENGTH/TABLE_ROWS, 2) as 'å¹³å‡è¡Œå¤§å°',
        CASE 
            WHEN ROW_FORMAT = 'Compressed' THEN 'å·²å‹ç¼©'
            WHEN DATA_LENGTH > 100*1024*1024 THEN 'å»ºè®®å‹ç¼©'
            ELSE 'æ— éœ€å‹ç¼©'
        END as 'å‹ç¼©å»ºè®®'
    FROM information_schema.TABLES 
    WHERE TABLE_SCHEMA = '$DB_NAME'
    AND ENGINE = 'InnoDB'
    AND TABLE_ROWS > 0
    ORDER BY DATA_LENGTH DESC
    LIMIT 10;"
}

# 3. åŠ å¯†è¡¨çŠ¶æ€æ£€æŸ¥
check_encryption() {
    log_info "æ£€æŸ¥è¡¨åŠ å¯†çŠ¶æ€..."
    
    # æ£€æŸ¥æ•æ„Ÿè¡¨æ˜¯å¦å·²åŠ å¯†
    SENSITIVE_TABLES="user_private_info customer_payment_info employee_salary"
    
    for table in $SENSITIVE_TABLES; do
        ENCRYPTION_STATUS=$(mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME -s -N -e "
            SELECT CREATE_OPTIONS 
            FROM information_schema.TABLES 
            WHERE TABLE_SCHEMA = '$DB_NAME' 
            AND TABLE_NAME = '$table';" 2>/dev/null
        )
        
        if [[ $ENCRYPTION_STATUS == *"ENCRYPTION='Y'"* ]]; then
            log_info "è¡¨ $table å·²åŠ å¯† âœ“"
        else
            log_warn "è¡¨ $table æœªåŠ å¯†ï¼Œå»ºè®®å¯ç”¨åŠ å¯†"
        fi
    done
}

# 4. è¡¨ç©ºé—´ä½¿ç”¨ç›‘æ§
monitor_tablespaces() {
    log_info "ç›‘æ§è¡¨ç©ºé—´ä½¿ç”¨æƒ…å†µ..."
    
    mysql -h$DB_HOST -u$DB_USER -p$DB_PASS -e "
    SELECT 
        TABLESPACE_NAME as 'è¡¨ç©ºé—´',
        FILE_NAME as 'æ–‡ä»¶è·¯å¾„',
        ROUND(FILE_SIZE/1024/1024, 2) AS 'å¤§å°MB',
        ROUND(AUTOEXTEND_SIZE/1024/1024, 2) AS 'è‡ªåŠ¨æ‰©å±•MB',
        CASE 
            WHEN MAX_SIZE IS NULL THEN 'æ— é™åˆ¶'
            ELSE ROUND(MAX_SIZE/1024/1024, 2)
        END AS 'æœ€å¤§å¤§å°MB'
    FROM information_schema.FILES 
    WHERE TABLESPACE_NAME IS NOT NULL
    AND TABLESPACE_NAME NOT LIKE 'innodb_%'
    ORDER BY FILE_SIZE DESC;"
}

# 5. æ€§èƒ½å»ºè®®ç”Ÿæˆ
generate_recommendations() {
    log_info "ç”Ÿæˆè¡¨ä¼˜åŒ–å»ºè®®..."
    
    mysql -h$DB_HOST -u$DB_USER -p$DB_PASS $DB_NAME -e "
    SELECT 
        TABLE_NAME as 'è¡¨å',
        ROUND((DATA_LENGTH+INDEX_LENGTH)/1024/1024, 2) as 'æ€»å¤§å°MB',
        TABLE_ROWS as 'è¡Œæ•°',
        CONCAT(
            CASE 
                WHEN ROW_FORMAT != 'Compressed' AND DATA_LENGTH > 200*1024*1024 
                THEN 'å»ºè®®å¯ç”¨å‹ç¼©; '
                ELSE ''
            END,
            CASE 
                WHEN TABLE_ROWS > 5000000 AND PARTITION_NAME IS NULL 
                THEN 'å»ºè®®è€ƒè™‘åˆ†åŒº; '
                ELSE ''
            END,
            CASE 
                WHEN DATA_FREE > DATA_LENGTH * 0.25 
                THEN 'å»ºè®®æ‰§è¡ŒOPTIMIZE TABLE; '
                ELSE ''
            END,
            CASE 
                WHEN CREATE_OPTIONS NOT LIKE '%ENCRYPTION%' 
                AND TABLE_NAME IN ('user_private_info', 'payment_info', 'employee_data')
                THEN 'å»ºè®®å¯ç”¨åŠ å¯†; '
                ELSE ''
            END
        ) as 'ä¼˜åŒ–å»ºè®®'
    FROM information_schema.TABLES t
    LEFT JOIN information_schema.PARTITIONS p 
        ON t.TABLE_NAME = p.TABLE_NAME AND t.TABLE_SCHEMA = p.TABLE_SCHEMA
    WHERE t.TABLE_SCHEMA = '$DB_NAME'
    AND t.ENGINE = 'InnoDB'
    AND t.TABLE_ROWS > 1000
    HAVING LENGTH(ä¼˜åŒ–å»ºè®®) > 0
    ORDER BY (t.DATA_LENGTH + t.INDEX_LENGTH) DESC;"
}

# ä¸»æ‰§è¡Œæµç¨‹
main() {
    log_info "å¼€å§‹MySQLé«˜çº§è¡¨ç»´æŠ¤æ£€æŸ¥..."
    echo "=========================================="
    
    maintain_partitions
    echo
    check_compression  
    echo
    check_encryption
    echo
    monitor_tablespaces
    echo
    generate_recommendations
    
    echo "=========================================="
    log_info "ç»´æŠ¤æ£€æŸ¥å®Œæˆ"
}

# æ‰§è¡Œç»´æŠ¤
main "$@"
```

### 8.7 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥æ¸…å•


**ğŸ“‹ é«˜çº§è¡¨é€‰é¡¹ç”Ÿäº§ç¯å¢ƒæ¸…å•**
```yaml
# advanced-table-checklist.yaml
ç”Ÿäº§ç¯å¢ƒé«˜çº§è¡¨é…ç½®æ£€æŸ¥æ¸…å•:

å®‰å…¨æ€§æ£€æŸ¥:
  - [ ] æ•æ„Ÿæ•°æ®è¡¨å·²å¯ç”¨åŠ å¯†
  - [ ] åŠ å¯†å¯†é’¥ä½¿ç”¨ä¼ä¸šçº§ç®¡ç†
  - [ ] å®¡è®¡æ—¥å¿—å·²é…ç½®
  - [ ] è¡¨è®¿é—®æƒé™æœ€å°åŒ–
  - [ ] å¤‡ä»½æ•°æ®åŠ å¯†ä¿æŠ¤

æ€§èƒ½ä¼˜åŒ–:
  - [ ] å¤§è¡¨å·²é…ç½®åˆ†åŒºç­–ç•¥
  - [ ] åˆ†åŒºé”®é€‰æ‹©åˆç†
  - [ ] å†å²æ•°æ®ä½¿ç”¨å‹ç¼©å­˜å‚¨
  - [ ] è¡¨ç©ºé—´æŒ‰æ€§èƒ½éœ€æ±‚åˆ†é…
  - [ ] è¡Œæ ¼å¼æ ¹æ®æ•°æ®ç‰¹ç‚¹é€‰æ‹©

å­˜å‚¨ç®¡ç†:
  - [ ] è¡¨ç©ºé—´ç£ç›˜åˆ†å¸ƒåˆç†
  - [ ] å‹ç¼©è¡¨ç©ºé—´èŠ‚çœéªŒè¯
  - [ ] åˆ†åŒºè‡ªåŠ¨ç®¡ç†è„šæœ¬å°±ç»ª
  - [ ] å­˜å‚¨å®¹é‡ç›‘æ§å‘Šè­¦

è¿ç»´è‡ªåŠ¨åŒ–:
  - [ ] åˆ†åŒºç»´æŠ¤è‡ªåŠ¨åŒ–è„šæœ¬
  - [ ] è¡¨ç»Ÿè®¡ä¿¡æ¯è‡ªåŠ¨æ›´æ–°
  - [ ] ç¢ç‰‡æ•´ç†å®šæœŸæ‰§è¡Œ
  - [ ] æ€§èƒ½ç›‘æ§å‘Šè­¦é…ç½®

ç¾éš¾æ¢å¤:
  - [ ] åŠ å¯†è¡¨å¤‡ä»½æ¢å¤æµ‹è¯•
  - [ ] åˆ†åŒºè¡¨æ¢å¤æµç¨‹éªŒè¯
  - [ ] è¡¨ç©ºé—´è¿ç§»æ–¹æ¡ˆå‡†å¤‡
  - [ ] ç´§æ€¥æ¢å¤é¢„æ¡ˆæ–‡æ¡£
```

### 8.8 æ ¸å¿ƒè¦ç‚¹æ€»ç»“


**ğŸ’¡ å¿…é¡»ç†è§£çš„è®¾è®¡åŸåˆ™**
```
é«˜çº§è¡¨é€‰é¡¹ä½¿ç”¨åŸåˆ™ï¼š
â€¢ é»˜è®¤å¤Ÿç”¨ï¼šå¤§éƒ¨åˆ†åœºæ™¯ç”¨é»˜è®¤InnoDBå³å¯
â€¢ ç‰¹æ®Šåœºæ™¯ï¼šæœ‰æ˜ç¡®éœ€æ±‚æ‰ä½¿ç”¨é«˜çº§é€‰é¡¹  
â€¢ æµ‹è¯•éªŒè¯ï¼šç”Ÿäº§ä½¿ç”¨å‰å……åˆ†æµ‹è¯•
â€¢ ç›‘æ§è¯„ä¼°ï¼šæŒç»­ç›‘æ§é€‰é¡¹æ•ˆæœ

è¡¨å¼•æ“é€‰æ‹©é€»è¾‘ï¼š
â€¢ InnoDBï¼š99%åœºæ™¯çš„é»˜è®¤é€‰æ‹©
â€¢ CSVï¼šæ•°æ®äº¤æ¢å’Œæ—¥å¿—åœºæ™¯
â€¢ MERGEï¼šå†å²æ•°æ®åˆå¹¶åœºæ™¯
â€¢ FEDERATEDï¼šè·¨åº“è®¿é—®åœºæ™¯
â€¢ Memoryï¼šä¸´æ—¶é«˜é€Ÿç¼“å­˜åœºæ™¯
```

**ğŸ” å…³é”®æŠ€æœ¯ç†è§£**
```
åŠ å¯†è¡¨æ ¸å¿ƒï¼š
â€¢ é€æ˜åŠ å¯†ï¼šåº”ç”¨æ— æ„ŸçŸ¥
â€¢ å¯†é’¥ç®¡ç†ï¼šå®‰å…¨çš„æ ¸å¿ƒ
â€¢ æ€§èƒ½å½±å“ï¼š5-15%çš„CPUå¼€é”€
â€¢ å¤‡ä»½å®‰å…¨ï¼šå¤‡ä»½æ•°æ®ä¿æŠ¤

åˆ†åŒºè¡¨æ ¸å¿ƒï¼š
â€¢ åˆ†åŒºè£å‰ªï¼šæŸ¥è¯¢æ€§èƒ½çš„å…³é”®
â€¢ åˆ†åŒºé”®è®¾è®¡ï¼šå½±å“æŸ¥è¯¢æ•ˆç‡
â€¢ ç»´æŠ¤è‡ªåŠ¨åŒ–ï¼šç”Ÿäº§ç¯å¢ƒå¿…éœ€
â€¢ æ•°æ®åˆ†å¸ƒï¼šé¿å…çƒ­ç‚¹åˆ†åŒº

å‹ç¼©è¡¨æ ¸å¿ƒï¼š
â€¢ å‹ç¼©æ¯”ï¼šå­˜å‚¨ç©ºé—´vsæ€§èƒ½
â€¢ å—å¤§å°ï¼šæ•°æ®ç‰¹ç‚¹å†³å®š
â€¢ ç›‘æ§æŒ‡æ ‡ï¼šå‹ç¼©æ•ˆæœè¯„ä¼°
â€¢ é€‚ç”¨åœºæ™¯ï¼šå½’æ¡£å’Œå¤§æ•°æ®é‡
```

**âš¡ å®é™…åº”ç”¨ä»·å€¼**
- **æˆæœ¬ä¼˜åŒ–**ï¼šå‹ç¼©è¡¨å‡å°‘50-80%å­˜å‚¨æˆæœ¬
- **æ€§èƒ½æå‡**ï¼šåˆ†åŒºè¡¨æŸ¥è¯¢é€Ÿåº¦æå‡10-100å€  
- **å®‰å…¨åŠ å¼º**ï¼šåŠ å¯†è¡¨ä¿æŠ¤æ•æ„Ÿæ•°æ®åˆè§„
- **è¿ç»´ç®€åŒ–**ï¼šè¡¨ç©ºé—´ç®¡ç†ä¾¿äºå­˜å‚¨è§„åˆ’
- **æ¶æ„çµæ´»**ï¼šç‰¹æ®Šå¼•æ“åº”å¯¹ç‰¹æ®Šéœ€æ±‚

**æ ¸å¿ƒè®°å¿†**ï¼š
- é«˜çº§é€‰é¡¹è§£å†³ç‰¹æ®Šéœ€æ±‚ï¼Œä¸æ˜¯ä¸ºäº†ç‚«æŠ€
- å®‰å…¨æ•æ„Ÿç”¨åŠ å¯†ï¼Œå¤§æ•°æ®ç”¨åˆ†åŒºï¼Œçœç©ºé—´ç”¨å‹ç¼©
- æ¯ä¸ªé€‰é¡¹éƒ½æœ‰é€‚ç”¨åœºæ™¯å’Œæ€§èƒ½æƒè¡¡
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ç›‘æ§å’Œè‡ªåŠ¨åŒ–ç»´æŠ¤
- è®¾è®¡ä¹‹åˆè€ƒè™‘é•¿è¿œï¼Œé¿å…åæœŸç—›è‹¦é‡æ„