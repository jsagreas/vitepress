---
title: 3、系统数据库详解
---
## 📚 目录

1. [MySQL系统数据库概述](#1-mysql系统数据库概述)
2. [mysql系统库详解](#2-mysql系统库详解)
3. [information_schema信息库](#3-information_schema信息库)
4. [performance_schema性能库](#4-performance_schema性能库)
5. [sys系统视图库](#5-sys系统视图库)
6. [系统库管理维护](#6-系统库管理维护)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🗄️ MySQL系统数据库概述


### 1.1 什么是系统数据库


**简单理解**：系统数据库就像MySQL的"大脑"，存储着MySQL运行所需的所有配置信息和状态数据

```
MySQL数据库全景：
┌─────────────────────────────┐
│      MySQL实例              │
├─────────────────────────────┤
│  🏛️ 系统数据库（4个）        │
│  ├── mysql                 │ ← 用户权限、配置信息
│  ├── information_schema    │ ← 元数据信息
│  ├── performance_schema    │ ← 性能监控数据
│  └── sys                  │ ← 系统管理视图
├─────────────────────────────┤
│  📊 用户数据库（N个）        │
│  ├── business_db           │ ← 业务数据库1
│  ├── shop_db              │ ← 业务数据库2
│  └── ...                  │ ← 其他业务数据库
└─────────────────────────────┘
```

### 1.2 系统数据库功能概览


**🔑 四大系统数据库的分工**

| 数据库名 | 主要作用 | 核心内容 | 使用频率 |
|----------|----------|----------|----------|
| **mysql** | 权限管理 | 用户、权限、配置 | ⭐⭐⭐ 最高 |
| **information_schema** | 元数据查询 | 数据库结构信息 | ⭐⭐⭐ 很高 |
| **performance_schema** | 性能监控 | 运行时性能数据 | ⭐⭐ 中等 |
| **sys** | 管理辅助 | 友好的管理视图 | ⭐⭐ 中等 |

> 💡 **学习重点**  
> 对于新手来说，**mysql** 和 **information_schema** 是必须重点掌握的，后两个了解即可

### 1.3 系统数据库的特殊性


**与普通数据库的区别**：
- ✅ **系统管理**：由MySQL自动创建和维护
- ✅ **访问限制**：某些表不能直接修改
- ✅ **自动更新**：随着MySQL操作自动更新内容
- ✅ **版本相关**：不同MySQL版本结构可能不同

**⚠️ 重要注意事项**
- ❌ **不要随意删除**系统数据库，会导致MySQL无法正常运行
- ❌ **不要直接修改**系统表数据，要通过SQL语句操作
- ⚠️ **谨慎操作**权限相关的系统表

---

## 2. 🏛️ mysql系统库详解


### 2.1 mysql系统库概述


**含义**：mysql系统库是MySQL的"户籍管理部门"，管理着所有用户账号和权限信息

**核心作用**：
- 🎯 **用户认证**：存储所有MySQL用户的账号信息
- 🎯 **权限控制**：记录每个用户能做什么、不能做什么
- 🎯 **系统配置**：保存MySQL运行时的各种设置

### 2.2 用户权限表结构


**MySQL权限系统的层级结构**：
```
权限控制层级（从高到低）：
🏢 全局级别    → mysql.user表
🏬 数据库级别  → mysql.db表  
🏪 表级别      → mysql.tables_priv表
📋 列级别      → mysql.columns_priv表
⚙️ 存储过程级别 → mysql.procs_priv表
```

### 2.3 mysql.user用户表结构详解


**🔥 mysql.user用户表是权限系统的核心**

**简单理解**：user表就像公司的"员工花名册"，记录了每个员工的身份信息和基本权限

**核心字段分类**：

#### 身份标识字段

```sql
-- 查看user表的基本结构
DESC mysql.user;

-- 身份标识字段
Host        varchar(255)  -- 允许连接的主机地址
User        varchar(32)   -- 用户名
```

**Host字段说明**：
- `localhost`：只能本地连接
- `%`：可以从任何地址连接
- `192.168.1.%`：只能从192.168.1网段连接
- `specific_ip`：只能从指定IP连接

#### 认证字段

```sql
-- 认证相关字段
authentication_string  text     -- 加密后的密码
password_expired      enum     -- 密码是否过期
password_lifetime     smallint -- 密码有效期天数
account_locked        enum     -- 账户是否被锁定
```

#### 全局权限字段

```sql
-- 全局权限字段（Y/N值）
Select_priv          enum('N','Y')  -- 全局SELECT权限
Insert_priv          enum('N','Y')  -- 全局INSERT权限  
Update_priv          enum('N','Y')  -- 全局UPDATE权限
Delete_priv          enum('N','Y')  -- 全局DELETE权限
Create_priv          enum('N','Y')  -- 全局CREATE权限
Drop_priv            enum('N','Y')  -- 全局DROP权限
Reload_priv          enum('N','Y')  -- 重新加载权限
Process_priv         enum('N','Y')  -- 查看进程权限
File_priv            enum('N','Y')  -- 文件操作权限
Grant_priv           enum('N','Y')  -- 授权给其他用户的权限
Super_priv           enum('N','Y')  -- 超级用户权限
```

**权限字段实际含义**：
- ✅ **Y**：拥有该权限
- ❌ **N**：没有该权限

**查看用户权限示例**：
```sql
-- 查看特定用户的权限
SELECT Host, User, Select_priv, Insert_priv, Update_priv 
FROM mysql.user 
WHERE User = 'test_user';

-- 结果示例：
+------+-----------+-------------+-------------+-------------+
| Host | User      | Select_priv | Insert_priv | Update_priv |
+------+-----------+-------------+-------------+-------------+
| %    | test_user | Y           | Y           | N           |
+------+-----------+-------------+-------------+-------------+
```

### 2.4 mysql.db权限表详解


**🔥 mysql.db数据库级权限表**

**简单理解**：db表就像"部门权限清单"，记录每个用户在每个数据库中的具体权限

**核心字段结构**：
```sql
-- 标识字段
Host            varchar(255)   -- 主机地址
Db              varchar(64)    -- 数据库名称
User            varchar(32)    -- 用户名

-- 权限字段（与user表类似，但作用范围仅限特定数据库）
Select_priv     enum('N','Y')  -- 在该数据库的SELECT权限
Insert_priv     enum('N','Y')  -- 在该数据库的INSERT权限
Update_priv     enum('N','Y')  -- 在该数据库的UPDATE权限
Delete_priv     enum('N','Y')  -- 在该数据库的DELETE权限
Create_priv     enum('N','Y')  -- 在该数据库的CREATE权限
Drop_priv       enum('N','Y')  -- 在该数据库的DROP权限
Index_priv      enum('N','Y')  -- 创建和删除索引权限
Alter_priv      enum('N','Y')  -- 修改表结构权限
```

**权限匹配顺序**：
1. 先检查 `mysql.user` 表的全局权限
2. 如果全局权限不足，再检查 `mysql.db` 表的数据库权限
3. 两者结合决定最终权限

**实际应用示例**：
```sql
-- 查看用户在特定数据库的权限
SELECT Host, Db, User, Select_priv, Insert_priv, Update_priv
FROM mysql.db 
WHERE User = 'app_user' AND Db = 'business_db';

-- 典型结果：
+------+-------------+----------+-------------+-------------+-------------+
| Host | Db          | User     | Select_priv | Insert_priv | Update_priv |
+------+-------------+----------+-------------+-------------+-------------+
| %    | business_db | app_user | Y           | Y           | Y           |
+------+-------------+----------+-------------+-------------+-------------+
```

### 2.5 mysql.tables_priv表权限详解


**🔥 mysql.tables_priv表级权限控制**

**简单理解**：tables_priv表就像"办公桌使用权限登记表"，记录每个人对每张桌子（表）的使用权限

**核心字段**：
```sql
Host            varchar(255)   -- 主机地址
Db              varchar(64)    -- 数据库名
User            varchar(32)    -- 用户名  
Table_name      varchar(64)    -- 表名
Grantor         varchar(255)   -- 授权者
Timestamp       timestamp      -- 授权时间
Table_priv      set(...)       -- 表级权限集合
Column_priv     set(...)       -- 列级权限集合
```

**Table_priv权限集合说明**：
```
可能的权限值：
- Select     ← 查询表数据
- Insert     ← 插入数据到表
- Update     ← 更新表数据
- Delete     ← 删除表数据
- Create     ← 创建新表
- Drop       ← 删除表
- Index      ← 创建和删除索引
- Alter      ← 修改表结构
```

**权限设置示例**：
```sql
-- 给用户授予特定表的权限
GRANT SELECT, INSERT ON business_db.orders TO 'order_user'@'%';

-- 查看表权限
SELECT Host, Db, User, Table_name, Table_priv 
FROM mysql.tables_priv 
WHERE User = 'order_user';
```

### 2.6 mysql.columns_priv列权限详解


**🔥 mysql.columns_priv列级权限控制**

**简单理解**：columns_priv表就像"保险柜格子权限表"，精确控制每个人能访问保险柜里的哪个格子（列）

**应用场景**：
- 🎯 **敏感字段保护**：如工资、身份证号只允许特定用户查看
- 🎯 **数据脱敏**：不同角色看到不同程度的数据详情
- 🎯 **精细化权限**：比表级权限更加精确的控制

**核心字段**：
```sql
Host            varchar(255)   -- 主机地址
Db              varchar(64)    -- 数据库名
User            varchar(32)    -- 用户名
Table_name      varchar(64)    -- 表名
Column_name     varchar(64)    -- 列名
Timestamp       timestamp      -- 授权时间
Column_priv     set(...)       -- 列权限集合
```

**实际应用示例**：
```sql
-- 只允许HR查看员工工资列
GRANT SELECT (name, department) ON company.employees TO 'normal_user'@'%';
GRANT SELECT (name, department, salary) ON company.employees TO 'hr_user'@'%';

-- 查看列级权限
SELECT User, Table_name, Column_name, Column_priv 
FROM mysql.columns_priv 
WHERE Db = 'company';
```

### 2.7 mysql.procs_priv存储过程权限


**🔥 mysql.procs_priv存储过程权限管理**

**简单理解**：procs_priv表管理着谁可以执行哪些存储过程和函数，就像"特殊工具使用权限表"

**核心字段**：
```sql
Host            varchar(255)   -- 主机地址
Db              varchar(64)    -- 数据库名
User            varchar(32)    -- 用户名
Routine_name    varchar(64)    -- 存储过程/函数名
Routine_type    enum('FUNCTION','PROCEDURE') -- 类型
Grantor         varchar(255)   -- 授权者
Proc_priv       set(...)       -- 过程权限
Timestamp       timestamp      -- 授权时间
```

**权限类型**：
- `Execute`：执行存储过程的权限
- `Alter Routine`：修改存储过程的权限
- `Grant`：将权限授予其他用户的权限

### 2.8 其他重要系统表


**mysql系统库表详解**：

**配置相关表**：
```sql
-- 时区配置表
mysql.time_zone          -- 时区定义
mysql.time_zone_name     -- 时区名称映射

-- 帮助系统表
mysql.help_topic        -- 帮助主题
mysql.help_category     -- 帮助分类
mysql.help_keyword      -- 帮助关键字
```

**服务器相关表**：
```sql
-- 服务器信息表
mysql.servers           -- 联邦存储引擎服务器信息
mysql.plugin            -- 插件信息
mysql.component         -- 组件信息（MySQL 8.0+）
```

---

## 3. 📊 information_schema信息库


### 3.1 information_schema概述


**含义**：information_schema是MySQL的"数据字典"，提供了数据库中所有对象的详细信息

**特点**：
- 🔸 **只读**：不能修改，只能查询
- 🔸 **虚拟表**：实际上是视图，数据来源于系统内部
- 🔸 **标准化**：遵循SQL标准的INFORMATION_SCHEMA规范

### 3.2 核心元数据表


**数据库和表信息**：
```sql
-- 查看所有数据库
SELECT SCHEMA_NAME FROM information_schema.SCHEMATA;

-- 查看数据库中的所有表
SELECT TABLE_NAME, TABLE_TYPE, ENGINE 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database';

-- 查看表的详细信息
SELECT TABLE_NAME, TABLE_ROWS, DATA_LENGTH, INDEX_LENGTH
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database'
ORDER BY DATA_LENGTH DESC;
```

**字段信息查询**：
```sql
-- 查看表的所有字段信息
SELECT COLUMN_NAME, DATA_TYPE, IS_NULLABLE, COLUMN_DEFAULT, COLUMN_COMMENT
FROM information_schema.COLUMNS 
WHERE TABLE_SCHEMA = 'your_database' 
AND TABLE_NAME = 'your_table'
ORDER BY ORDINAL_POSITION;
```

**索引信息查询**：
```sql
-- 查看表的索引信息
SELECT INDEX_NAME, COLUMN_NAME, SEQ_IN_INDEX, NON_UNIQUE
FROM information_schema.STATISTICS 
WHERE TABLE_SCHEMA = 'your_database' 
AND TABLE_NAME = 'your_table';
```

### 3.3 实用查询示例


**元数据存储机制的实际应用**：

<details>
<summary>🔧 点击查看常用元数据查询</summary>

```sql
-- 1. 查找所有包含特定字段的表
SELECT TABLE_SCHEMA, TABLE_NAME 
FROM information_schema.COLUMNS 
WHERE COLUMN_NAME = 'user_id';

-- 2. 统计数据库中各表的数据量
SELECT 
    TABLE_NAME as '表名',
    TABLE_ROWS as '行数',
    ROUND(DATA_LENGTH/1024/1024, 2) as '数据大小(MB)',
    ROUND(INDEX_LENGTH/1024/1024, 2) as '索引大小(MB)'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database'
ORDER BY DATA_LENGTH DESC;

-- 3. 查找没有主键的表
SELECT TABLE_SCHEMA, TABLE_NAME
FROM information_schema.TABLES t
WHERE t.TABLE_TYPE = 'BASE TABLE'
AND NOT EXISTS (
    SELECT 1 FROM information_schema.KEY_COLUMN_USAGE k
    WHERE k.TABLE_SCHEMA = t.TABLE_SCHEMA
    AND k.TABLE_NAME = t.TABLE_NAME
    AND k.CONSTRAINT_NAME = 'PRIMARY'
);
```

</details>

---

## 4. 📈 performance_schema性能库


### 4.1 performance_schema概述


**含义**：performance_schema是MySQL的"体检报告生成器"，实时监控MySQL的运行状态和性能指标

**核心价值**：
- 🎯 **性能诊断**：找出系统性能瓶颈
- 🎯 **资源监控**：监控CPU、内存、I/O使用情况
- 🎯 **SQL分析**：分析哪些SQL语句最消耗资源

### 4.2 主要监控表类别


**事件监控表**：
```sql
-- 当前正在执行的语句
SELECT * FROM performance_schema.events_statements_current;

-- 历史执行语句汇总
SELECT * FROM performance_schema.events_statements_summary_by_digest;

-- 等待事件监控
SELECT * FROM performance_schema.events_waits_current;
```

**性能监控实用查询**：
```sql
-- 查看最耗时的SQL语句
SELECT 
    DIGEST_TEXT as 'SQL语句',
    COUNT_STAR as '执行次数',
    ROUND(AVG_TIMER_WAIT/1000000000000, 2) as '平均耗时(秒)'
FROM performance_schema.events_statements_summary_by_digest 
ORDER BY AVG_TIMER_WAIT DESC 
LIMIT 10;
```

### 4.3 表空间和内存监控


**内存使用情况**：
```sql
-- 查看内存使用情况
SELECT 
    EVENT_NAME as '内存区域',
    CURRENT_NUMBER_OF_BYTES_USED/1024/1024 as '当前使用(MB)'
FROM performance_schema.memory_summary_global_by_event_name 
WHERE CURRENT_NUMBER_OF_BYTES_USED > 0
ORDER BY CURRENT_NUMBER_OF_BYTES_USED DESC;
```

**表空间监控**：
```sql
-- 查看表空间使用情况
SELECT 
    TABLE_SCHEMA as '数据库名',
    TABLE_NAME as '表名',
    ROUND(DATA_LENGTH/1024/1024, 2) as '数据大小(MB)',
    ROUND(INDEX_LENGTH/1024/1024, 2) as '索引大小(MB)'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
ORDER BY DATA_LENGTH DESC;
```

---

## 5. 🔧 sys系统视图库


### 5.1 sys库概述


**含义**：sys库是MySQL的"友好助手"，将复杂的performance_schema数据转换为容易理解的视图

**设计目标**：
- 🎯 **简化查询**：复杂的性能分析查询变成简单的SELECT
- 🎯 **人性化展示**：数据展示更加直观易懂
- 🎯 **运维友好**：为数据库管理员提供便利工具

### 5.2 常用sys视图


**性能分析视图**：
```sql
-- 查看最耗时的语句
SELECT * FROM sys.statements_with_runtimes_in_95th_percentile;

-- 查看未使用的索引
SELECT * FROM sys.schema_unused_indexes;

-- 查看重复索引
SELECT * FROM sys.schema_redundant_indexes;

-- 查看表空间使用情况
SELECT * FROM sys.schema_table_statistics;
```

**系统状态视图**：
```sql
-- 查看连接使用情况
SELECT * FROM sys.processlist;

-- 查看锁等待情况
SELECT * FROM sys.innodb_lock_waits;

-- 查看文件I/O统计
SELECT * FROM sys.io_global_by_file_by_bytes;
```

---

## 6. 🛠️ 系统库管理维护


### 6.1 系统表修改限制


**⚠️ 系统表操作注意事项**

**绝对不能做的操作**：
```sql
-- ❌ 千万不要这样做！
DROP DATABASE mysql;                    -- 删除mysql系统库
DELETE FROM mysql.user;                 -- 清空用户表
TRUNCATE TABLE mysql.user;              -- 截断用户表
UPDATE mysql.user SET User = 'hacker';  -- 直接修改系统表
```

**正确的操作方式**：
```sql
-- ✅ 正确的用户管理方式
CREATE USER 'new_user'@'%' IDENTIFIED BY 'password';
GRANT SELECT ON database.* TO 'new_user'@'%';
DROP USER 'old_user'@'%';
FLUSH PRIVILEGES;  -- 刷新权限缓存
```

### 6.2 系统表备份恢复策略


**🔑 系统库备份的重要性**

**为什么要备份系统库**：
- 🎯 **权限恢复**：系统崩溃后快速恢复用户权限
- 🎯 **配置保存**：保存重要的系统配置
- 🎯 **迁移部署**：新环境快速部署相同配置

**备份策略**：
```bash
# 1. 备份mysql系统库
mysqldump -u root -p --single-transaction mysql > mysql_system_backup.sql

# 2. 备份权限信息
mysqldump -u root -p --single-transaction \
  --tables mysql user db tables_priv columns_priv procs_priv \
  > mysql_privileges_backup.sql

# 3. 导出用户权限（可读格式）
mysql -u root -p -e "
SELECT CONCAT('CREATE USER ''', User, '''@''', Host, ''' IDENTIFIED BY PASSWORD ''', 
              authentication_string, ''';') as 'Create User Statement'
FROM mysql.user WHERE User != 'root';" > user_recreate.sql
```

**恢复策略**：
```bash
# 1. 恢复系统库（谨慎操作）
mysql -u root -p mysql < mysql_system_backup.sql

# 2. 刷新权限
mysql -u root -p -e "FLUSH PRIVILEGES;"

# 3. 验证恢复结果
mysql -u root -p -e "SELECT User, Host FROM mysql.user;"
```

### 6.3 系统表性能影响分析


**🔸 系统表性能影响因素**

**查询性能考虑**：
```sql
-- 高频查询会影响系统表性能
-- 例如：频繁查询用户权限
SELECT * FROM mysql.user WHERE User = 'app_user';

-- 优化建议：MySQL会自动缓存权限信息
-- 避免直接查询系统表，使用SHOW语句
SHOW GRANTS FOR 'app_user'@'%';
```

**权限缓存机制**：
- ✅ MySQL会缓存用户权限信息在内存中
- ✅ 只有执行 `FLUSH PRIVILEGES` 时才重新加载
- ✅ 日常权限检查不会频繁访问系统表

### 6.4 系统库升级兼容性


**🔸 MySQL版本升级时的系统库处理**

**升级过程中的变化**：
```
MySQL 5.7 → MySQL 8.0 升级要点：

1. 密码认证方式变化：
   旧版：password 字段存储密码哈希
   新版：authentication_string 字段 + plugin 认证插件

2. 系统表引擎迁移：
   旧版：MyISAM 存储引擎
   新版：InnoDB 存储引擎（更好的事务支持）

3. 数据字典改进：
   旧版：.frm 文件存储表结构
   新版：集中存储在 mysql.ibd 中
```

**🔥 系统表InnoDB引擎迁移**

**迁移的好处**：
- ✅ **事务支持**：系统表操作也支持事务了
- ✅ **崩溃恢复**：更好的崩溃恢复能力
- ✅ **并发性能**：支持行级锁，并发性能更好

**迁移注意事项**：
```bash
# 升级前检查
mysql_upgrade --check-upgrade

# 执行升级
mysql_upgrade -u root -p

# 升级后验证
SELECT TABLE_NAME, ENGINE 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'mysql';
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 系统数据库：mysql、information_schema、performance_schema、sys四大系统库
🔸 权限体系：user→db→tables_priv→columns_priv→procs_priv五级权限控制
🔸 元数据管理：information_schema提供所有数据库对象的结构信息
🔸 性能监控：performance_schema实时监控系统运行状态
🔸 管理工具：sys库提供友好的管理和分析视图
🔸 安全操作：通过SQL语句操作权限，不直接修改系统表
```

### 7.2 关键理解要点


**🔹 权限系统的层次结构**
```
MySQL权限检查就像"通行证验证"：
1. 全局权限（user表）：是否有"全园通行证"
2. 数据库权限（db表）：是否有"特定园区通行证"  
3. 表权限（tables_priv表）：是否有"特定建筑物通行证"
4. 列权限（columns_priv表）：是否有"特定房间通行证"
5. 过程权限（procs_priv表）：是否有"特殊设备使用证"
```

**🔹 系统库的协作关系**
```
四个系统库分工合作：
- mysql：保存"人事档案"（用户权限）
- information_schema：提供"组织架构图"（数据库结构）
- performance_schema：生成"体检报告"（性能数据）
- sys：制作"友好总结"（管理视图）
```

**🔹 元数据的重要性**
```
元数据就像"建筑图纸"：
- 记录每个数据库、表、字段的详细信息
- 应用程序可以通过元数据动态适应数据库结构
- 数据库管理工具依赖元数据展示信息
- 备份恢复工具需要元数据确定操作范围
```

### 7.3 实际应用价值


**🎯 日常运维场景**
- 📍 **权限管理**：通过系统表查看和分析用户权限分配
- 📍 **性能优化**：利用performance_schema找出性能瓶颈
- 📍 **容量规划**：通过information_schema统计数据库大小增长趋势
- 📍 **安全审计**：分析用户权限分配是否合理

**🎯 开发应用场景**  
- 📍 **动态查询**：应用程序根据元数据动态生成SQL
- 📍 **数据迁移**：基于元数据自动生成建表语句
- 📍 **监控告警**：基于性能数据自动触发告警
- 📍 **权限校验**：应用程序检查用户是否有操作权限

**🎯 故障排查场景**
- 📍 **权限问题**：检查mysql.user和mysql.db确定权限配置
- 📍 **性能问题**：分析performance_schema找出慢查询
- 📍 **空间问题**：通过information_schema分析表空间使用
- 📍 **连接问题**：查看sys.processlist分析连接状态

**核心记忆要点**：
```
系统数据库四兄弟，各有分工要记住
mysql管权限，information管结构
performance管性能，sys管理助手
权限分五级，从全局到列细
元数据是基础，性能监控是工具
安全操作很重要，直接修改要避免
```