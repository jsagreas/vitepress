---
title: 10、MySQL状态变量监控基础
---
##  📚 目录

1. [状态变量基本概念](#1-状态变量基本概念)
2. [SHOW STATUS命令详解](#2-SHOW-STATUS命令详解)
3. [状态变量分类系统](#3-状态变量分类系统)
4. [连接状态监控](#4-连接状态监控)
5. [查询统计状态分析](#5-查询统计状态分析)
6. [缓存命中率监控](#6-缓存命中率监控)
7. [常用状态指标说明](#7-常用状态指标说明)
8. [状态监控基础方法](#8-状态监控基础方法)
9. [核心要点总结](#9-核心要点总结)

---

##  1. 🔍 状态变量基本概念


## # 1.1 什么是状态变量


**🔸 通俗理解**
状态变量就像汽车仪表盘上的各种指示器，实时显示MySQL数据库的"健康状况"：
- **里程表**：显示总共处理了多少次查询
- **油量表**：显示缓存使用情况
- **温度表**：显示系统负载状态
- **转速表**：显示当前处理能力

> 💡 **核心概念**  
> 状态变量是MySQL服务器运行过程中产生的统计信息，记录着数据库从启动到现在的各种操作数据。通过这些数据，我们可以了解数据库的性能表现和运行状态。

## # 1.2 状态变量的作用


**🔸 主要用途**
- **性能监控**：了解数据库运行效率
- **问题诊断**：定位性能瓶颈和故障原因
- **容量规划**：预测资源需求
- **优化指导**：为调优提供数据支撑

## # 1.3 状态变量与系统变量的区别


| 类型 | **性质** | **作用** | **修改方式** | **举例** |
|------|---------|---------|-------------|---------|
| 🔧 **系统变量** | `配置参数` | `控制MySQL行为` | `可修改` | `max_connections=100` |
| 📊 **状态变量** | `统计信息` | `反映运行状态` | `只读` | `Connections=1520` |

> 🤔 **形象比喻**  
> 系统变量像空调的温度设置（你可以调节），状态变量像温度计显示的当前温度（只能查看）。

---

##  2. 📋 SHOW STATUS命令详解


## # 2.1 基本语法格式


**🔸 命令语法**
```sql
SHOW [GLOBAL | SESSION] STATUS 
[LIKE 'pattern' | WHERE expr];
```

**🔸 语法要素解释**
- **GLOBAL**：查看全局状态（从服务器启动到现在）
- **SESSION**：查看当前会话状态（从连接建立到现在）
- **LIKE**：模糊匹配状态变量名
- **WHERE**：条件过滤状态变量

## # 2.2 基础使用示例


**🔸 查看所有状态变量**
```sql
-- 查看全局状态（最常用）
SHOW GLOBAL STATUS;

-- 查看当前会话状态
SHOW SESSION STATUS;
-- 或者简写为
SHOW STATUS;
```

**🔸 模糊查询特定状态**
```sql
-- 查看所有连接相关状态
SHOW GLOBAL STATUS LIKE 'Conn%';

-- 查看所有查询相关状态  
SHOW GLOBAL STATUS LIKE '%queries%';

-- 查看InnoDB相关状态
SHOW GLOBAL STATUS LIKE 'Innodb%';
```

**🔸 条件查询状态**
```sql
-- 查看数值大于1000的状态变量
SHOW GLOBAL STATUS WHERE Value > 1000;

-- 查看特定变量的当前值
SHOW GLOBAL STATUS WHERE Variable_name = 'Connections';
```

## # 2.3 SHOW STATUS查看技巧


**🔸 常用查询模式**

> 🛠️ **实用技巧**  
> 使用`LIKE`模糊匹配可以快速找到相关的状态变量，不需要记住完整的变量名。

```sql
-- 快速查看核心性能指标
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Connections',
    'Queries', 
    'Slow_queries',
    'Uptime'
);
```

---

##  3. 🏷️ 状态变量分类系统


## # 3.1 Global vs Session 作用域


**🔸 Global状态变量**
记录整个MySQL服务器从启动到现在的累积统计：

```sql
-- 查看服务器总运行时间
SHOW GLOBAL STATUS LIKE 'Uptime';
-- 结果如：Uptime = 86400 (表示运行了1天)

-- 查看总连接数
SHOW GLOBAL STATUS LIKE 'Connections';  
-- 结果如：Connections = 15230 (启动以来总连接数)
```

**🔸 Session状态变量**
记录当前连接会话的统计信息：

```sql
-- 查看当前连接的查询次数
SHOW SESSION STATUS LIKE 'Questions';
-- 结果如：Questions = 25 (本次连接执行了25个SQL)

-- 查看当前连接创建的临时表数
SHOW SESSION STATUS LIKE 'Created_tmp_tables';
```

## # 3.2 状态变量功能分类


**🔸 按功能模块分类**

```
                    MySQL状态变量分类图
    ┌─────────────────────────────────────────────────┐
    │                 MySQL状态变量                    │
    │                                                 │
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐         │
    │  │ 连接相关 │  │ 查询相关 │  │ 缓存相关 │         │
    │  │Connection│  │ Query   │  │ Cache   │         │
    │  └─────────┘  └─────────┘  └─────────┘         │
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐         │
    │  │ 存储相关 │  │ 锁相关  │  │ 复制相关 │         │
    │  │ Storage │  │ Lock    │  │Replication│         │
    │  └─────────┘  └─────────┘  └─────────┘         │
    └─────────────────────────────────────────────────┘
```

| 分类 | **监控重点** | **关键变量** | **性能意义** |
|------|-------------|-------------|-------------|
| 🔗 **连接类** | `连接数、拒绝数` | `Connections、Aborted_connects` | `连接性能、稳定性` |
| 📊 **查询类** | `查询次数、慢查询` | `Queries、Slow_queries` | `查询性能、优化需求` |
| 💾 **缓存类** | `命中率、使用率` | `Query_cache_hits、Key_reads` | `内存效率、IO压力` |
| 🔒 **锁类** | `锁等待、死锁` | `Table_locks_waited、Innodb_deadlocks` | `并发性能` |

---

##  4. 🔗 连接状态监控


## # 4.1 核心连接状态指标


**🔸 基础连接统计**

```sql
-- 查看连接相关的核心状态
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Connections',           -- 总连接数
    'Max_used_connections',  -- 峰值并发连接数
    'Aborted_connects',      -- 连接中断数
    'Aborted_clients',       -- 客户端异常断开数
    'Threads_connected',     -- 当前连接数
    'Threads_running'        -- 当前活跃连接数
);
```

**🔸 连接状态详解**

| 状态变量 | **含义解释** | **正常范围** | **异常信号** |
|---------|-------------|-------------|-------------|
| 📈 **Connections** | `从启动到现在的总连接次数` | `稳定增长` | `突然暴增` |
| 🔝 **Max_used_connections** | `历史最高并发连接数` | `< max_connections * 80%` | `接近配置上限` |
| ❌ **Aborted_connects** | `连接建立失败的次数` | `< Connections * 1%` | `比例过高` |
| 🏃 **Threads_running** | `正在执行SQL的连接数` | `< CPU核心数 * 2` | `持续很高` |

## # 4.2 连接健康度评估


**🔸 连接质量计算**

```sql
-- 连接成功率计算
SELECT 
    VARIABLE_VALUE as total_connections,
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Aborted_connects') as failed_connections,
    ROUND(
        (1 - (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
              WHERE VARIABLE_NAME='Aborted_connects') / VARIABLE_VALUE) * 100, 2
    ) as success_rate_percent
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME='Connections';
```

**🔸 连接池使用率监控**

> 💡 **监控要点**  
> 连接池使用率长期超过80%，说明可能需要增加max_connections配置，或者优化应用的连接使用方式。

```sql
-- 查看连接池使用情况
SELECT 
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Max_used_connections') as peak_connections,
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_VARIABLES 
     WHERE VARIABLE_NAME='max_connections') as max_connections,
    ROUND(
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
         WHERE VARIABLE_NAME='Max_used_connections') /
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_VARIABLES 
         WHERE VARIABLE_NAME='max_connections') * 100, 2
    ) as usage_rate_percent;
```

---

##  5. 📊 查询统计状态分析


## # 5.1 查询性能核心指标


**🔸 基础查询统计**

```sql
-- 查看查询相关核心状态
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Questions',             -- SQL语句总数
    'Queries',              -- 查询总数（包括存储过程内部）
    'Slow_queries',         -- 慢查询数量
    'Select_range',         -- 范围查询次数
    'Select_scan',          -- 全表扫描次数
    'Sort_scan'             -- 排序扫描次数
);
```

**🔸 查询类型分析**

| 查询类型 | **状态变量** | **含义说明** | **性能指标** |
|---------|-------------|-------------|-------------|
| 🔍 **SELECT查询** | `Com_select` | `SELECT语句执行次数` | `查询频率` |
| ✏️ **INSERT操作** | `Com_insert` | `INSERT语句执行次数` | `写入频率` |
| 🔄 **UPDATE操作** | `Com_update` | `UPDATE语句执行次数` | `修改频率` |
| ❌ **DELETE操作** | `Com_delete` | `DELETE语句执行次数` | `删除频率` |

## # 5.2 查询效率分析


**🔸 查询效率计算**

```sql
-- 慢查询比例分析
SELECT 
    VARIABLE_VALUE as total_queries,
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Slow_queries') as slow_queries,
    ROUND(
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
         WHERE VARIABLE_NAME='Slow_queries') / VARIABLE_VALUE * 100, 4
    ) as slow_query_rate_percent
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME='Questions';
```

> ⚠️ **性能警告**  
> 慢查询比例超过1%就需要关注，超过5%说明存在严重的性能问题，需要立即优化。

**🔸 查询模式分析**

```sql
-- 查询模式统计
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Select_full_join',      -- 无索引连接数
    'Select_range_check',    -- 范围检查数  
    'Sort_merge_passes',     -- 排序合并次数
    'Created_tmp_tables',    -- 创建临时表数
    'Created_tmp_disk_tables' -- 磁盘临时表数
);
```

## # 5.3 查询优化指导


**🔸 问题查询识别**

```
全表扫描过多问题：
Select_scan值很高 ──▶ 缺少合适索引 ──▶ 需要添加索引

临时表过多问题：
Created_tmp_tables值高 ──▶ 复杂查询或排序 ──▶ 优化SQL或增加内存

磁盘临时表问题：  
Created_tmp_disk_tables > 0 ──▶ 内存不足 ──▶ 调整tmp_table_size
```

---

##  6. 💾 缓存命中率监控


## # 6.1 InnoDB缓冲池监控


**🔸 Buffer Pool核心状态**

> 💡 **缓存理解**  
> Buffer Pool就像图书馆的阅览室，把最常用的书（数据页）放在手边。命中率高说明大部分请求都能在"阅览室"找到，不用跑到书库（磁盘）去拿。

```sql
-- InnoDB缓冲池关键状态
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Innodb_buffer_pool_reads',        -- 物理读取次数（从磁盘）
    'Innodb_buffer_pool_read_requests', -- 逻辑读取次数（从内存）
    'Innodb_buffer_pool_pages_total',   -- 缓冲池总页数
    'Innodb_buffer_pool_pages_free',    -- 空闲页数
    'Innodb_buffer_pool_pages_dirty'    -- 脏页数（待写入磁盘）
);
```

## # 6.2 缓存命中率计算


**🔸 Buffer Pool命中率**

```sql
-- 计算InnoDB缓冲池命中率
SELECT 
    ROUND(
        (1 - 
         (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
          WHERE VARIABLE_NAME='Innodb_buffer_pool_reads') /
         (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
          WHERE VARIABLE_NAME='Innodb_buffer_pool_read_requests')
        ) * 100, 2
    ) as buffer_pool_hit_rate_percent;
```

**🔸 命中率评估标准**

| 命中率范围 | **性能评估** | **建议措施** |
|-----------|-------------|-------------|
| 🟢 **> 99%** | `优秀` | `保持现状` |
| 🟡 **95-99%** | `良好` | `可适当优化` |
| 🟠 **90-95%** | `一般` | `需要调整Buffer Pool大小` |
| 🔴 **< 90%** | `较差` | `紧急优化内存配置` |

## # 6.3 其他缓存监控


**🔸 查询缓存监控**

```sql
-- 查询缓存相关状态（MySQL 5.7及以下版本）
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Qcache_hits',           -- 查询缓存命中次数
    'Qcache_inserts',        -- 缓存插入次数
    'Qcache_queries_in_cache', -- 缓存中的查询数
    'Qcache_free_memory'     -- 缓存空闲内存
);
```

> ⚠️ **版本提醒**  
> MySQL 8.0已经完全移除了查询缓存功能，因为在高并发环境下缓存锁竞争反而会降低性能。

**🔸 键缓存监控（MyISAM）**

```sql
-- MyISAM索引缓存状态
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Key_reads',             -- 索引块物理读取
    'Key_read_requests',     -- 索引块逻辑读取
    'Key_writes',            -- 索引块物理写入
    'Key_write_requests'     -- 索引块逻辑写入  
);
```

---

##  7. 📈 常用状态指标说明


## # 7.1 性能核心指标


**🔸 系统级性能指标**

```sql
-- 系统运行核心指标
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Uptime',                -- 运行时间（秒）
    'Questions',             -- SQL语句总数
    'Queries',              -- 查询总数
    'Bytes_sent',           -- 发送字节数
    'Bytes_received'        -- 接收字节数
);
```

**🔸 指标含义详解**

| 指标名称 | **计算方式** | **正常表现** | **异常信号** |
|---------|-------------|-------------|-------------|
| 📊 **QPS** | `Questions / Uptime` | `稳定范围内` | `突然暴增或骤降` |
| 📈 **TPS** | `(Com_commit + Com_rollback) / Uptime` | `与业务匹配` | `与预期差异很大` |
| 🌐 **网络吞吐** | `(Bytes_sent + Bytes_received) / Uptime` | `符合带宽能力` | `接近带宽上限` |

## # 7.2 存储引擎状态指标


**🔸 InnoDB核心状态**

```sql
-- InnoDB存储引擎关键状态
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Innodb_rows_read',      -- 读取行数
    'Innodb_rows_inserted',  -- 插入行数
    'Innodb_rows_updated',   -- 更新行数
    'Innodb_rows_deleted',   -- 删除行数
    'Innodb_data_reads',     -- 数据读取次数
    'Innodb_data_writes'     -- 数据写入次数
);
```

**🔸 事务处理状态**

> 💡 **事务理解**  
> 事务就像银行转账，要么全部成功，要么全部失败。监控事务状态可以了解数据库的业务处理情况。

```sql
-- 事务处理状态
SHOW GLOBAL STATUS WHERE Variable_name IN (
    'Com_commit',            -- 提交的事务数
    'Com_rollback',          -- 回滚的事务数
    'Innodb_deadlocks'       -- 死锁发生次数
);
```

---

##  8. 🛠️ 状态监控基础方法


## # 8.1 定期监控脚本


**🔸 基础监控脚本**

```sql
-- 创建监控视图，方便日常检查
CREATE VIEW mysql_health_check AS
SELECT 
    -- 连接状态
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Threads_connected') as current_connections,
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_VARIABLES 
     WHERE VARIABLE_NAME='max_connections') as max_connections,
    
    -- 查询性能  
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Questions') as total_questions,
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Slow_queries') as slow_queries,
    
    -- 缓存效率
    ROUND(
        (1 - (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
              WHERE VARIABLE_NAME='Innodb_buffer_pool_reads') /
             (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
              WHERE VARIABLE_NAME='Innodb_buffer_pool_read_requests')
        ) * 100, 2
    ) as buffer_pool_hit_rate;

-- 使用监控视图
SELECT * FROM mysql_health_check;
```

## # 8.2 状态变量监控最佳实践


**🔸 监控频率建议**

| 监控类型 | **频率** | **关注指标** | **处理策略** |
|---------|---------|-------------|-------------|
| 🔴 **实时监控** | `每分钟` | `当前连接数、活跃查询` | `超阈值立即告警` |
| 🟡 **常规监控** | `每5分钟` | `QPS、慢查询、缓存命中率` | `趋势分析，定期优化` |
| 🟢 **趋势监控** | `每小时` | `累积统计、容量增长` | `容量规划，长期优化` |

**🔸 告警阈值设置**

> 🚨 **告警建议**  
> 根据业务特点设置合理的告警阈值，避免告警过于频繁或过于滞后。

```sql
-- 典型告警条件检查
SELECT 
    CASE 
        WHEN current_connections / max_connections > 0.8 
        THEN '连接数告警：使用率超过80%'
        WHEN slow_queries / total_questions > 0.01 
        THEN '慢查询告警：慢查询比例超过1%'  
        WHEN buffer_pool_hit_rate < 95 
        THEN '缓存告警：Buffer Pool命中率低于95%'
        ELSE '系统状态正常'
    END as health_status
FROM mysql_health_check;
```

## # 8.3 监控数据历史记录


**🔸 状态数据收集**

```sql
-- 创建状态历史记录表
CREATE TABLE mysql_status_history (
    id INT AUTO_INCREMENT PRIMARY KEY,
    check_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    connections INT,
    max_used_connections INT,
    questions INT,
    slow_queries INT,
    buffer_pool_hit_rate DECIMAL(5,2),
    qps DECIMAL(10,2)
);

-- 定期插入状态数据（可以用定时任务）
INSERT INTO mysql_status_history (
    connections, max_used_connections, questions, 
    slow_queries, buffer_pool_hit_rate, qps
) 
SELECT 
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Threads_connected'),
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Max_used_connections'),
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Questions'),
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Slow_queries'),
    -- Buffer Pool命中率计算
    ROUND((1 - 
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
         WHERE VARIABLE_NAME='Innodb_buffer_pool_reads') /
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
         WHERE VARIABLE_NAME='Innodb_buffer_pool_read_requests')
    ) * 100, 2),
    -- QPS计算  
    ROUND(
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
         WHERE VARIABLE_NAME='Questions') /
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
         WHERE VARIABLE_NAME='Uptime'), 2
    );
```

---

##  9. 📋 核心要点总结


## # 9.1 状态变量监控要点


**🔑 掌握程度自测**
- [x] 理解状态变量的基本概念和作用
- [x] 熟练使用SHOW STATUS命令  
- [x] 了解Global和Session的区别
- [x] 能计算关键性能指标
- [ ] 能设计完整的监控方案

**🔸 核心监控方法**
```
监控三步法：
1️⃣ 收集状态数据 ──▶ SHOW STATUS命令
2️⃣ 分析性能指标 ──▶ 计算命中率、使用率
3️⃣ 识别问题趋势 ──▶ 对比历史数据，发现异常
```

## # 9.2 关键状态指标速查


**🔸 必知必会状态变量**

| 分类 | **核心变量** | **关键公式** | **理想值** |
|------|-------------|-------------|-----------|
| 🔗 **连接** | `Threads_connected` | `当前连接数/最大连接数` | `< 80%` |
| 📊 **查询** | `Slow_queries` | `慢查询数/总查询数` | `< 1%` |
| 💾 **缓存** | `Innodb_buffer_pool_*` | `(逻辑读-物理读)/逻辑读` | `> 99%` |
| ⚡ **性能** | `Questions/Uptime` | `QPS = 问题数/运行时间` | `业务相关` |

## # 9.3 监控实践建议


**🔸 日常监控重点**

> 🎯 **监控策略**  
> 重点关注趋势变化而不是绝对数值。突然的变化往往比高数值更需要关注。

```
日常检查清单：
1. 连接数是否正常 ──▶ 避免连接池耗尽
2. 慢查询是否增多 ──▶ 及时发现性能问题  
3. 缓存命中率变化 ──▶ 评估内存配置效果
4. 错误日志内容 ──▶ 发现系统异常
```

**🔸 性能基线建立**

```sql
-- 建立性能基线（业务正常时的状态）
SELECT 
    NOW() as baseline_time,
    'Normal Business Hours' as period_desc,
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Questions') / 
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
     WHERE VARIABLE_NAME='Uptime') as baseline_qps,
    -- 记录其他关键指标...
;
```

**🔸 监控工具推荐**

| 工具类型 | **工具名称** | **适用场景** | **特点** |
|---------|-------------|-------------|---------|
| 🔧 **命令行** | `mysqladmin` | `快速检查` | `轻量级，脚本友好` |
| 📊 **图形化** | `Workbench、phpMyAdmin` | `直观查看` | `用户友好，功能丰富` |
| 📈 **专业监控** | `Zabbix、Prometheus` | `企业监控` | `告警、趋势、集成` |

---

**💡 学习要点总结**：
- 状态变量是MySQL的"健康体检报告"
- SHOW STATUS是查看状态的基本命令
- Global和Session提供不同视角的统计信息
- 关键指标的计算公式要熟练掌握
- 监控重在趋势分析和异常发现
- 结合业务特点建立合理的监控体系