---
title: 7ã€MySQLç«¯å£ä¸Žé˜²ç«å¢™é…ç½®
---
## ðŸ“š ç›®å½•

1. [ç½‘ç»œç«¯å£åŸºç¡€é…ç½®](#1-ç½‘ç»œç«¯å£åŸºç¡€é…ç½®)
2. [MySQLé»˜è®¤ç«¯å£3306å®‰å…¨é…ç½®](#2-MySQLé»˜è®¤ç«¯å£3306å®‰å…¨é…ç½®)
3. [è‡ªå®šä¹‰ç«¯å£é€‰æ‹©ç­–ç•¥](#3-è‡ªå®šä¹‰ç«¯å£é€‰æ‹©ç­–ç•¥)
4. [é˜²ç«å¢™å®‰å…¨ç­–ç•¥](#4-é˜²ç«å¢™å®‰å…¨ç­–ç•¥)
5. [å¤šå®žä¾‹ç«¯å£è§„åˆ’](#5-å¤šå®žä¾‹ç«¯å£è§„åˆ’)
6. [ç«¯å£å†²çªè§£å†³æ–¹æ³•](#6-ç«¯å£å†²çªè§£å†³æ–¹æ³•)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŒ ç½‘ç»œç«¯å£åŸºç¡€é…ç½®


### 1.1 ä»€ä¹ˆæ˜¯ç½‘ç»œç«¯å£ï¼Ÿ


**ðŸ’¡ ç«¯å£çš„æœ¬è´¨ç†è§£**

> ç½‘ç»œç«¯å£å°±åƒå…¬å¯“æ¥¼çš„é—¨ç‰Œå·ï¼ŒæœåŠ¡å™¨æ˜¯æ•´æ ‹æ¥¼ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå ç”¨ä¸€ä¸ªæˆ¿é—´ï¼ˆç«¯å£å·ï¼‰ï¼Œå®¢æˆ·ç«¯è¦è®¿é—®ç‰¹å®šæœåŠ¡ï¼Œå°±å¿…é¡»çŸ¥é“æ­£ç¡®çš„"é—¨ç‰Œå·"ã€‚

```
ç½‘ç»œç«¯å£å·¥ä½œåŽŸç†ï¼š

æœåŠ¡å™¨IPåœ°å€: 192.168.1.100 (è¿™æ˜¯"å¤§æ¥¼åœ°å€")
     â†“
ç«¯å£åˆ†é…ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç«¯å£22   â†  SSHæœåŠ¡ (è¿œç¨‹ç®¡ç†)              â”‚
â”‚  ç«¯å£80   â†  Apache WebæœåŠ¡                 â”‚
â”‚  ç«¯å£3306 â†  MySQLæ•°æ®åº“æœåŠ¡                â”‚
â”‚  ç«¯å£6379 â†  Redisç¼“å­˜æœåŠ¡                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ðŸ”¢ ç«¯å£å·åˆ†ç±»**

| **ç«¯å£èŒƒå›´** | **ç±»åž‹** | **ç”¨é€”** | **MySQLç›¸å…³** |
|-------------|---------|---------|-------------|
| **0-1023** | `ç³»ç»Ÿç«¯å£` | `ç³»ç»ŸæœåŠ¡ä¿ç•™` | `ä¸å»ºè®®ä½¿ç”¨` |
| **1024-49151** | `æ³¨å†Œç«¯å£` | `åº”ç”¨ç¨‹åºæ³¨å†Œ` | `MySQL 3306åœ¨æ­¤èŒƒå›´` |
| **49152-65535** | `åŠ¨æ€ç«¯å£` | `ä¸´æ—¶åˆ†é…` | `å¯ç”¨äºŽè‡ªå®šä¹‰å®žä¾‹` |

### 1.2 MySQLç«¯å£åŸºç¡€çŸ¥è¯†


**ðŸŽ¯ MySQLç«¯å£çš„ä½œç”¨**

MySQLç«¯å£æ˜¯å®¢æˆ·ç«¯è¿žæŽ¥æ•°æ®åº“çš„"å¤§é—¨"ï¼š
- **ç›‘å¬è¿žæŽ¥**ï¼šMySQLæœåŠ¡åœ¨æŒ‡å®šç«¯å£ç­‰å¾…å®¢æˆ·ç«¯è¿žæŽ¥
- **æ•°æ®ä¼ è¾“**ï¼šæ‰€æœ‰SQLæŸ¥è¯¢å’Œç»“æžœéƒ½é€šè¿‡æ­¤ç«¯å£ä¼ è¾“
- **å®‰å…¨æŽ§åˆ¶**ï¼šé€šè¿‡ç«¯å£æŽ§åˆ¶å“ªäº›å®¢æˆ·ç«¯å¯ä»¥è®¿é—®æ•°æ®åº“

```bash
# æŸ¥çœ‹MySQLæ˜¯å¦åœ¨ç›‘å¬ç«¯å£
netstat -tlnp | grep 3306
# è¾“å‡ºç¤ºä¾‹ï¼š
# tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN 1234/mysqld

# ä½¿ç”¨sså‘½ä»¤æŸ¥çœ‹ï¼ˆæ›´çŽ°ä»£çš„æ–¹å¼ï¼‰
ss -tlnp | grep 3306
```

---

## 2. ðŸ” MySQLé»˜è®¤ç«¯å£3306å®‰å…¨é…ç½®


### 2.1 ä¸ºä»€ä¹ˆMySQLé€‰æ‹©3306ç«¯å£ï¼Ÿ


**ðŸ“– ç«¯å£3306çš„æ¥åŽ†**

3306è¿™ä¸ªæ•°å­—ä¸æ˜¯éšä¾¿é€‰çš„ï¼š
- **åŽ†å²åŽŸå› **ï¼šMySQL ABå…¬å¸çš„é‚®æ”¿ç¼–ç ä¸­åŒ…å«3306
- **é¿å…å†²çª**ï¼šå½“æ—¶è¿™ä¸ªç«¯å£å·æ²¡æœ‰è¢«å…¶ä»–çŸ¥åæœåŠ¡å ç”¨
- **æ˜“äºŽè®°å¿†**ï¼šæ•°å­—ç»„åˆç›¸å¯¹å®¹æ˜“è®°ä½

> **é‡è¦æé†’**ï¼šæ­£å› ä¸º3306æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„MySQLç«¯å£ï¼Œæ”»å‡»è€…ç»å¸¸æ‰«æè¿™ä¸ªç«¯å£ï¼Œæ‰€ä»¥å®‰å…¨é…ç½®å¾ˆé‡è¦ï¼

### 2.2 é»˜è®¤ç«¯å£çš„å®‰å…¨é£Žé™©


**âš ï¸ ä½¿ç”¨é»˜è®¤ç«¯å£3306çš„å®‰å…¨é£Žé™©**

```
å®‰å…¨é£Žé™©åˆ†æžï¼š

    ç½‘ç»œæ‰«æ                æš´åŠ›ç ´è§£              æ‹’ç»æœåŠ¡æ”»å‡»
       â†“                      â†“                    â†“
  â€¢ ç«¯å£æ‰«æå·¥å…·           â€¢ å¯†ç å­—å…¸æ”»å‡»        â€¢ å¤§é‡è¿žæŽ¥è¯·æ±‚
  â€¢ è‡ªåŠ¨å‘çŽ°MySQL         â€¢ å¼±å¯†ç ç ´è§£          â€¢ è€—å°½è¿žæŽ¥èµ„æº
  â€¢ ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²           â€¢ é»˜è®¤è´¦æˆ·åˆ©ç”¨        â€¢ æœåŠ¡ä¸å¯ç”¨
```

### 2.3 é»˜è®¤ç«¯å£å®‰å…¨é…ç½®æœ€ä½³å®žè·µ


**ðŸ›¡ï¸ å®‰å…¨é…ç½®ç­–ç•¥**

```ini
# MySQLé…ç½®æ–‡ä»¶ my.cnf å®‰å…¨é…ç½®
[mysqld]
# åŸºç¡€ç«¯å£é…ç½®
port = 3306

# é‡è¦ï¼šç»‘å®šç‰¹å®šIPåœ°å€ï¼ˆä¸è¦ç»‘å®šåˆ°0.0.0.0ï¼‰
bind-address = 192.168.1.100  # åªå…è®¸å†…ç½‘è®¿é—®
# æˆ–è€…
bind-address = 127.0.0.1      # åªå…è®¸æœ¬æœºè®¿é—®

# ç¦ç”¨DNSåå‘è§£æžï¼ˆæé«˜è¿žæŽ¥é€Ÿåº¦ï¼Œå‡å°‘ä¿¡æ¯æ³„éœ²ï¼‰
skip-name-resolve = ON

# é™åˆ¶è¿žæŽ¥æ•°
max_connections = 200
max_connect_errors = 10

# è¶…æ—¶è®¾ç½®
connect_timeout = 10
wait_timeout = 28800
```

**ðŸ”’ ç›‘å¬åœ°å€é…ç½®è¯¦è§£**

| **é…ç½®** | **å«ä¹‰** | **å®‰å…¨æ€§** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|-----------|-------------|
| `bind-address = 0.0.0.0` | `ç›‘å¬æ‰€æœ‰ç½‘å¡` | `âš ï¸ é«˜é£Žé™©` | `éœ€è¦å¤–ç½‘è®¿é—®æ—¶è°¨æ…Žä½¿ç”¨` |
| `bind-address = 127.0.0.1` | `åªç›‘å¬æœ¬æœº` | `âœ… æœ€å®‰å…¨` | `å•æœºåº”ç”¨ï¼Œé€šè¿‡ä»£ç†è®¿é—®` |
| `bind-address = 192.168.1.100` | `ç›‘å¬æŒ‡å®šå†…ç½‘IP` | `âœ… è¾ƒå®‰å…¨` | `å†…ç½‘æœåŠ¡å™¨é›†ç¾¤` |
| `bind-address = ::1` | `IPv6æœ¬æœºå›žçŽ¯` | `âœ… å®‰å…¨` | `IPv6çŽ¯å¢ƒ` |

---

## 3. âš™ï¸ è‡ªå®šä¹‰ç«¯å£é€‰æ‹©ç­–ç•¥


### 3.1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è‡ªå®šä¹‰ç«¯å£ï¼Ÿ


**ðŸŽ¯ ä½¿ç”¨è‡ªå®šä¹‰ç«¯å£çš„å¥½å¤„**

```
è‡ªå®šä¹‰ç«¯å£çš„å®‰å…¨ä¼˜åŠ¿ï¼š

    éšè”½æ€§                    å‡å°‘æ”»å‡»              å¤šå®žä¾‹æ”¯æŒ
       â†“                      â†“                    â†“
  â€¢ é¿å¼€è‡ªåŠ¨æ‰«æ           â€¢ é™ä½Žè¢«å‘çŽ°æ¦‚çŽ‡        â€¢ åŒæœåŠ¡å™¨å¤šMySQL
  â€¢ å¢žåŠ æ”»å‡»æˆæœ¬           â€¢ å‡å°‘æ— æ•ˆè¿žæŽ¥å°è¯•      â€¢ ç«¯å£éš”ç¦»
  â€¢ å®‰å…¨é€šè¿‡æ¨¡ç³Š           â€¢ ä¸“æ³¨çœŸæ­£å¨èƒ          â€¢ ä¾¿äºŽç®¡ç†
```

### 3.2 è‡ªå®šä¹‰ç«¯å£é€‰æ‹©åŽŸåˆ™


**ðŸ“ ç«¯å£é€‰æ‹©æœ€ä½³å®žè·µ**

```bash
# 1. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tlnp | grep 33060
ss -tlnp | grep 33060

# 2. æ£€æŸ¥ç«¯å£èŒƒå›´æ˜¯å¦åˆé€‚
# å»ºè®®èŒƒå›´ï¼š10000-65000ï¼ˆé¿å…ç³»ç»Ÿç«¯å£å’Œå¸¸ç”¨åº”ç”¨ç«¯å£ï¼‰
```

**ðŸŽ² æŽ¨èçš„è‡ªå®šä¹‰ç«¯å£ç­–ç•¥**

| **ä½¿ç”¨åœºæ™¯** | **æŽ¨èç«¯å£èŒƒå›´** | **ç¤ºä¾‹** | **å‘½åè§„åˆ™** |
|-------------|----------------|---------|-------------|
| **ç”Ÿäº§çŽ¯å¢ƒ** | `10000-20000` | `13306, 13307` | `1 + åŽŸç«¯å£å·` |
| **æµ‹è¯•çŽ¯å¢ƒ** | `20000-30000` | `23306, 23307` | `2 + åŽŸç«¯å£å·` |
| **å¼€å‘çŽ¯å¢ƒ** | `30000-40000` | `33306, 33307` | `3 + åŽŸç«¯å£å·` |
| **å¤‡ä»½å®žä¾‹** | `40000-50000` | `43306, 43307` | `4 + åŽŸç«¯å£å·` |

### 3.3 ä¿®æ”¹MySQLç«¯å£é…ç½®


**âš™ï¸ ç«¯å£ä¿®æ”¹æ­¥éª¤**

```bash
# 1. åœæ­¢MySQLæœåŠ¡
systemctl stop mysqld

# 2. ä¿®æ”¹é…ç½®æ–‡ä»¶
vim /etc/my.cnf
```

```ini
[mysqld]
# ä¿®æ”¹ç«¯å£å·
port = 13306

# ç¡®ä¿socketæ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼ˆé¿å…åº”ç”¨è¿žæŽ¥é—®é¢˜ï¼‰
socket = /var/lib/mysql/mysql.sock

[client]
# å®¢æˆ·ç«¯é»˜è®¤è¿žæŽ¥ç«¯å£ä¹Ÿè¦ä¿®æ”¹
port = 13306
socket = /var/lib/mysql/mysql.sock
```

```bash
# 3. å¯åŠ¨MySQLæœåŠ¡
systemctl start mysqld

# 4. éªŒè¯ç«¯å£ä¿®æ”¹
ss -tlnp | grep 13306
mysql -P 13306 -h localhost -u root -p
```

> **é‡è¦æé†’**ï¼šä¿®æ”¹ç«¯å£åŽï¼Œæ‰€æœ‰è¿žæŽ¥MySQLçš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦æ›´æ–°è¿žæŽ¥é…ç½®ï¼

---

## 4. ðŸ›¡ï¸ é˜²ç«å¢™å®‰å…¨ç­–ç•¥


### 4.1 Linuxé˜²ç«å¢™åŸºç¡€


**ðŸ”¥ ä»€ä¹ˆæ˜¯é˜²ç«å¢™ï¼Ÿ**

> é˜²ç«å¢™å°±åƒå»ºç­‘ç‰©çš„å®‰ä¿ç³»ç»Ÿï¼Œå†³å®šå“ªäº›äººï¼ˆç½‘ç»œæµé‡ï¼‰å¯ä»¥è¿›å…¥ï¼Œå“ªäº›äººä¸èƒ½è¿›å…¥ã€‚å¯¹äºŽMySQLæ¥è¯´ï¼Œé˜²ç«å¢™æŽ§åˆ¶å“ªäº›IPåœ°å€å¯ä»¥è¿žæŽ¥åˆ°æ•°æ®åº“ç«¯å£ã€‚

```
é˜²ç«å¢™å·¥ä½œåŽŸç†ï¼š

å¤–ç½‘è¯·æ±‚ â†’ é˜²ç«å¢™æ£€æŸ¥ â†’ å…è®¸/æ‹’ç» â†’ MySQLæœåŠ¡
    â†‘          â†“              â†“         â†‘
 æ¥æºIP     è§„åˆ™åŒ¹é…        å†³ç­–        ç›®æ ‡ç«¯å£
ç«¯å£ä¿¡æ¯    ç™½åå•/é»‘åå•    é€šè¿‡/é˜»æ­¢   3306/è‡ªå®šä¹‰
```

### 4.2 iptablesé˜²ç«å¢™è§„åˆ™é…ç½®


**ðŸ”§ iptablesåŸºç¡€å‘½ä»¤**

```bash
# æŸ¥çœ‹å½“å‰é˜²ç«å¢™è§„åˆ™
iptables -L -n -v

# æŸ¥çœ‹INPUTé“¾è§„åˆ™ï¼ˆå…¥ç«™è§„åˆ™ï¼‰
iptables -L INPUT -n --line-numbers
```

**ðŸ“ MySQLç«¯å£é˜²ç«å¢™è§„åˆ™ç¤ºä¾‹**

```bash
# 1. å…è®¸æœ¬æœºè®¿é—®MySQL
iptables -A INPUT -i lo -p tcp --dport 3306 -j ACCEPT

# 2. å…è®¸ç‰¹å®šIPè®¿é—®MySQL
iptables -A INPUT -s 192.168.1.100 -p tcp --dport 3306 -j ACCEPT
iptables -A INPUT -s 192.168.1.101 -p tcp --dport 3306 -j ACCEPT

# 3. å…è®¸ç‰¹å®šç½‘æ®µè®¿é—®MySQL
iptables -A INPUT -s 192.168.1.0/24 -p tcp --dport 3306 -j ACCEPT

# 4. æ‹’ç»å…¶ä»–æ‰€æœ‰è®¿é—®MySQLçš„è¯·æ±‚
iptables -A INPUT -p tcp --dport 3306 -j DROP

# 5. ä¿å­˜è§„åˆ™ï¼ˆCentOS/RHELï¼‰
service iptables save
# æˆ–è€…ï¼ˆè¾ƒæ–°ç³»ç»Ÿï¼‰
iptables-save > /etc/iptables/rules.v4
```

**ðŸŽ¯ å¸¸ç”¨é˜²ç«å¢™è§„åˆ™æ¨¡æ¿**

```bash
#!/bin/bash
# MySQLé˜²ç«å¢™å®‰å…¨é…ç½®è„šæœ¬

# æ¸…ç©ºçŽ°æœ‰è§„åˆ™ï¼ˆè°¨æ…Žæ“ä½œï¼ï¼‰
# iptables -F

# 1. åŸºç¡€è§„åˆ™ï¼šå…è®¸å›žçŽ¯æŽ¥å£
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

# 2. å…è®¸å·²å»ºç«‹çš„è¿žæŽ¥
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# 3. MySQLç«¯å£è§„åˆ™
MYSQL_PORT=3306
ALLOWED_IPS=("192.168.1.100" "192.168.1.101" "10.0.0.50")

for ip in "${ALLOWED_IPS[@]}"; do
    iptables -A INPUT -s $ip -p tcp --dport $MYSQL_PORT -j ACCEPT
done

# 4. æ—¥å¿—è®°å½•è¢«æ‹’ç»çš„MySQLè¿žæŽ¥å°è¯•
iptables -A INPUT -p tcp --dport $MYSQL_PORT -j LOG --log-prefix "MySQL-DENY: "
iptables -A INPUT -p tcp --dport $MYSQL_PORT -j DROP

# 5. å…è®¸SSHï¼ˆç¡®ä¿ä¸ä¼šé”ä½è‡ªå·±ï¼‰
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# 6. é»˜è®¤ç­–ç•¥
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

echo "é˜²ç«å¢™è§„åˆ™é…ç½®å®Œæˆ"
```

### 4.3 firewalldçŽ°ä»£é˜²ç«å¢™ç®¡ç†


**ðŸ†• firewalld vs iptables**

firewalldæ˜¯è¾ƒæ–°Linuxå‘è¡Œç‰ˆçš„é»˜è®¤é˜²ç«å¢™ç®¡ç†å·¥å…·ï¼š

```bash
# æŸ¥çœ‹firewalldçŠ¶æ€
systemctl status firewalld

# æŸ¥çœ‹å½“å‰è§„åˆ™
firewall-cmd --list-all

# MySQLç«¯å£ç®¡ç†
# æ·»åŠ MySQLç«¯å£
firewall-cmd --permanent --add-port=3306/tcp
firewall-cmd --reload

# æ·»åŠ richè§„åˆ™ï¼ˆæ›´ç²¾ç¡®æŽ§åˆ¶ï¼‰
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.100" port protocol="tcp" port="3306" accept'

# åˆ›å»ºè‡ªå®šä¹‰æœåŠ¡ï¼ˆæŽ¨èæ–¹å¼ï¼‰
cat > /etc/firewalld/services/mysql-custom.xml << EOF
<?xml version="1.0" encoding="utf-8"?>
<service>
  <short>MySQL Custom</short>
  <description>MySQL Database Custom Port</description>
  <port protocol="tcp" port="13306"/>
</service>
EOF

firewall-cmd --permanent --add-service=mysql-custom
firewall-cmd --reload
```

---

## 5. ðŸ”¢ å¤šå®žä¾‹ç«¯å£è§„åˆ’


### 5.1 ä»€ä¹ˆæ˜¯MySQLå¤šå®žä¾‹ï¼Ÿ


**ðŸ¢ å¤šå®žä¾‹çš„æ¦‚å¿µ**

> MySQLå¤šå®žä¾‹å°±åƒåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå¼€å¤šå®¶"æ•°æ®åº“é¤åŽ…"ï¼Œæ¯å®¶é¤åŽ…æœ‰è‡ªå·±çš„é—¨ç‰Œå·ï¼ˆç«¯å£ï¼‰ã€æœåŠ¡å‘˜ï¼ˆè¿›ç¨‹ï¼‰ã€å’Œä»“åº“ï¼ˆæ•°æ®ç›®å½•ï¼‰ã€‚

```
å¤šå®žä¾‹æž¶æž„ç¤ºä¾‹ï¼š

æœåŠ¡å™¨ 192.168.1.100
â”œâ”€â”€ MySQLå®žä¾‹1 (ä¸»åº“)
â”‚   â”œâ”€â”€ ç«¯å£: 3306
â”‚   â”œâ”€â”€ æ•°æ®ç›®å½•: /var/lib/mysql1
â”‚   â””â”€â”€ é…ç½®æ–‡ä»¶: /etc/my1.cnf
â”œâ”€â”€ MySQLå®žä¾‹2 (ä»Žåº“)
â”‚   â”œâ”€â”€ ç«¯å£: 3307  
â”‚   â”œâ”€â”€ æ•°æ®ç›®å½•: /var/lib/mysql2
â”‚   â””â”€â”€ é…ç½®æ–‡ä»¶: /etc/my2.cnf
â””â”€â”€ MySQLå®žä¾‹3 (æµ‹è¯•)
    â”œâ”€â”€ ç«¯å£: 3308
    â”œâ”€â”€ æ•°æ®ç›®å½•: /var/lib/mysql3
    â””â”€â”€ é…ç½®æ–‡ä»¶: /etc/my3.cnf
```

### 5.2 å¤šå®žä¾‹ç«¯å£è§„åˆ’ç­–ç•¥


**ðŸ“Š ç«¯å£è§„åˆ’æœ€ä½³å®žè·µ**

| **å®žä¾‹ç±»åž‹** | **ç«¯å£è§„åˆ’** | **ç¤ºä¾‹** | **ç”¨é€”è¯´æ˜Ž** |
|-------------|-------------|---------|-------------|
| **ä¸»åº“å®žä¾‹** | `3306, 13306, 23306` | `ç”Ÿäº§ä¸»åº“:3306` | `ä¸»è¦ä¸šåŠ¡æ•°æ®åº“` |
| **ä»Žåº“å®žä¾‹** | `3307, 13307, 23307` | `è¯»å–ä»Žåº“:3307` | `è¯»å†™åˆ†ç¦»ï¼Œå¤‡ä»½` |
| **æµ‹è¯•å®žä¾‹** | `3308, 13308, 23308` | `æµ‹è¯•çŽ¯å¢ƒ:3308` | `å¼€å‘æµ‹è¯•ä½¿ç”¨` |
| **åˆ†æžå®žä¾‹** | `3309, 13309, 23309` | `æ•°æ®åˆ†æž:3309` | `æŠ¥è¡¨å’Œåˆ†æžæŸ¥è¯¢` |

**âš™ï¸ å¤šå®žä¾‹é…ç½®ç¤ºä¾‹**

```bash
# åˆ›å»ºå¤šå®žä¾‹ç›®å½•ç»“æž„
mkdir -p /data/mysql/{3306,3307,3308}/{data,logs,tmp}
```

```ini
# /etc/my3306.cnf - ä¸»åº“é…ç½®
[mysqld]
user = mysql
port = 3306
server-id = 1
socket = /data/mysql/3306/mysql.sock
datadir = /data/mysql/3306/data
log-error = /data/mysql/3306/logs/error.log
pid-file = /data/mysql/3306/mysql.pid
tmpdir = /data/mysql/3306/tmp

# /etc/my3307.cnf - ä»Žåº“é…ç½®  
[mysqld]
user = mysql
port = 3307
server-id = 2
socket = /data/mysql/3307/mysql.sock
datadir = /data/mysql/3307/data
log-error = /data/mysql/3307/logs/error.log
pid-file = /data/mysql/3307/mysql.pid
tmpdir = /data/mysql/3307/tmp
```

### 5.3 å¤šå®žä¾‹é˜²ç«å¢™é…ç½®


```bash
# å¤šå®žä¾‹é˜²ç«å¢™é…ç½®è„šæœ¬
#!/bin/bash
MYSQL_PORTS=(3306 3307 3308 3309)
ALLOWED_NETWORK="192.168.1.0/24"

for port in "${MYSQL_PORTS[@]}"; do
    # iptablesè§„åˆ™
    iptables -A INPUT -s $ALLOWED_NETWORK -p tcp --dport $port -j ACCEPT
    
    # firewalldè§„åˆ™
    firewall-cmd --permanent --add-port=${port}/tcp
done

# åº”ç”¨firewalldè§„åˆ™
firewall-cmd --reload
```

---

## 6. âš ï¸ ç«¯å£å†²çªè§£å†³æ–¹æ³•


### 6.1 ç«¯å£å†²çªçš„å¸¸è§åŽŸå› 


**ðŸ” ç«¯å£å†²çªåœºæ™¯åˆ†æž**

```
å¸¸è§ç«¯å£å†²çªæƒ…å†µï¼š

    å¤šä¸ªMySQLå®žä¾‹          å…¶ä»–åº”ç”¨å ç”¨           ç³»ç»ŸæœåŠ¡å†²çª
           â†“                    â†“                    â†“
    â€¢ é…ç½®æ–‡ä»¶é”™è¯¯        â€¢ WebæœåŠ¡å™¨å ç”¨        â€¢ ç³»ç»Ÿä¿ç•™ç«¯å£
    â€¢ å¯åŠ¨é¡ºåºé—®é¢˜        â€¢ åº”ç”¨ç¨‹åºå ç”¨        â€¢ é˜²ç«å¢™é…ç½®é”™è¯¯
    â€¢ è¿›ç¨‹æœªæ­£å¸¸é€€å‡º      â€¢ Dockerå®¹å™¨å ç”¨      â€¢ SELinuxé™åˆ¶
```

### 6.2 ç«¯å£å†²çªæ£€æµ‹æ–¹æ³•


**ðŸ”Ž æ£€æµ‹ç«¯å£å ç”¨çš„å‘½ä»¤**

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨netstatæ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 3306
# è¾“å‡ºç¤ºä¾‹ï¼štcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN 1234/mysqld

# æ–¹æ³•2ï¼šä½¿ç”¨sså‘½ä»¤ï¼ˆæŽ¨èï¼‰
ss -tlnp | grep 3306

# æ–¹æ³•3ï¼šä½¿ç”¨lsofæ£€æŸ¥ç«¯å£
lsof -i :3306

# æ–¹æ³•4ï¼šæ£€æŸ¥ç‰¹å®šè¿›ç¨‹çš„ç«¯å£å ç”¨
ps aux | grep mysqld
lsof -p è¿›ç¨‹ID

# æ–¹æ³•5ï¼šæ‰«æç«¯å£èŒƒå›´
nmap -p 3306-3310 localhost
```

**ðŸ“‹ ç«¯å£å†²çªæŽ’æŸ¥æ¸…å•**

- [ ] **æ£€æŸ¥è¿›ç¨‹çŠ¶æ€**ï¼š`ps aux | grep mysql`
- [ ] **æŸ¥çœ‹ç«¯å£å ç”¨**ï¼š`ss -tlnp | grep ç«¯å£å·`
- [ ] **æ£€æŸ¥é…ç½®æ–‡ä»¶**ï¼šç¡®è®¤ç«¯å£é…ç½®æ­£ç¡®
- [ ] **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**ï¼š`tail -f /var/log/mysqld.log`
- [ ] **æ£€æŸ¥é˜²ç«å¢™**ï¼šç¡®è®¤é˜²ç«å¢™è§„åˆ™
- [ ] **éªŒè¯æƒé™**ï¼šç¡®è®¤MySQLç”¨æˆ·æƒé™

### 6.3 ç«¯å£å†²çªè§£å†³æ–¹æ¡ˆ


**ðŸ› ï¸ è§£å†³æ–¹æ³•æ±‡æ€»**

```bash
# è§£å†³æ–¹æ¡ˆ1ï¼šæ€æ­»å ç”¨è¿›ç¨‹ï¼ˆè°¨æ…Žæ“ä½œï¼‰
# é¦–å…ˆç¡®è®¤è¿›ç¨‹
ps aux | grep mysqld
# æ€æ­»æŒ‡å®šè¿›ç¨‹
kill -9 è¿›ç¨‹ID

# è§£å†³æ–¹æ¡ˆ2ï¼šä¿®æ”¹MySQLç«¯å£
vim /etc/my.cnf
# ä¿®æ”¹ä¸ºæœªè¢«å ç”¨çš„ç«¯å£
port = 3307

# è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨systemdç®¡ç†å¤šå®žä¾‹
cat > /etc/systemd/system/mysqld@.service << EOF
[Unit]
Description=MySQL Server instance %i
After=network.target

[Service]
User=mysql
Group=mysql
ExecStart=/usr/sbin/mysqld --defaults-file=/etc/my%i.cnf
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨ä¸åŒå®žä¾‹
systemctl start mysqld@3306
systemctl start mysqld@3307
```

**ðŸš¨ åº”æ€¥å¤„ç†æµç¨‹**

```
ç«¯å£å†²çªåº”æ€¥å¤„ç†æ­¥éª¤ï¼š

1. ç«‹å³æ£€æŸ¥
   â†“
ss -tlnp | grep ç«¯å£

2. è¯†åˆ«å†²çªè¿›ç¨‹
   â†“  
ps aux | grep è¿›ç¨‹å

3. è¯„ä¼°å½±å“èŒƒå›´
   â†“
ç¡®è®¤æ˜¯å¦å½±å“ç”Ÿäº§ä¸šåŠ¡

4. é€‰æ‹©è§£å†³æ–¹æ¡ˆ
   â†“
â€¢ åœæ­¢å†²çªè¿›ç¨‹
â€¢ ä¿®æ”¹ç«¯å£é…ç½®  
â€¢ é‡å¯æœåŠ¡

5. éªŒè¯ä¿®å¤æ•ˆæžœ
   â†“
æµ‹è¯•æ•°æ®åº“è¿žæŽ¥

6. æ›´æ–°ç›‘æŽ§é…ç½®
   â†“
ä¿®æ”¹ç›‘æŽ§è„šæœ¬ç«¯å£
```

---

## 7. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ ç«¯å£æœ¬è´¨ï¼šç½‘ç»œæœåŠ¡çš„è®¿é—®å…¥å£ï¼ŒMySQLé€šè¿‡ç«¯å£æä¾›æ•°æ®åº“æœåŠ¡
ðŸ”¸ é»˜è®¤ç«¯å£ï¼š3306æ˜¯MySQLæ ‡å‡†ç«¯å£ï¼Œä½†å­˜åœ¨å®‰å…¨é£Žé™©
ðŸ”¸ è‡ªå®šä¹‰ç«¯å£ï¼šé€šè¿‡ä¿®æ”¹ç«¯å£å·æé«˜å®‰å…¨æ€§ï¼Œé¿å…è‡ªåŠ¨æ‰«æ
ðŸ”¸ é˜²ç«å¢™è§„åˆ™ï¼šæŽ§åˆ¶ç½‘ç»œè®¿é—®ï¼Œåªå…è®¸æŽˆæƒIPè¿žæŽ¥æ•°æ®åº“
ðŸ”¸ å¤šå®žä¾‹ç®¡ç†ï¼šä¸€å°æœåŠ¡å™¨è¿è¡Œå¤šä¸ªMySQLå®žä¾‹ï¼Œç«¯å£è§„åˆ’å¾ˆé‡è¦
ðŸ”¸ å†²çªè§£å†³ï¼šç«¯å£è¢«å ç”¨æ—¶çš„æŽ’æŸ¥å’Œè§£å†³æ–¹æ³•
```

### 7.2 å…³é”®é…ç½®ç†è§£


**ðŸ”¹ å®‰å…¨é…ç½®çš„æ ¸å¿ƒåŽŸåˆ™**
```
æœ€å°æƒé™åŽŸåˆ™ï¼šåªå¼€æ”¾å¿…è¦çš„ç«¯å£å’ŒIPè®¿é—®
æ·±åº¦é˜²å¾¡ï¼šå¤šå±‚å®‰å…¨æŽªæ–½ï¼Œä¸ä¾èµ–å•ä¸€é˜²æŠ¤
å®šæœŸå®¡æŸ¥ï¼šå®šæœŸæ£€æŸ¥ç«¯å£å’Œé˜²ç«å¢™é…ç½®
```

**ðŸ”¹ å¤šå®žä¾‹è§„åˆ’çš„æœ€ä½³å®žè·µ**
```
ç«¯å£è§„å¾‹ï¼šä½¿ç”¨æœ‰è§„å¾‹çš„ç«¯å£å·ä¾¿äºŽç®¡ç†
ç›®å½•éš”ç¦»ï¼šæ¯ä¸ªå®žä¾‹ç‹¬ç«‹çš„æ•°æ®å’Œæ—¥å¿—ç›®å½•
é…ç½®åˆ†ç¦»ï¼šæ¯ä¸ªå®žä¾‹ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶
æœåŠ¡ç®¡ç†ï¼šä½¿ç”¨systemdç­‰å·¥å…·ç»Ÿä¸€ç®¡ç†
```

**ðŸ”¹ ç›‘å¬åœ°å€çš„å®‰å…¨è€ƒè™‘**
```
æœ¬æœºè®¿é—®ï¼šbind-address = 127.0.0.1ï¼ˆæœ€å®‰å…¨ï¼‰
å†…ç½‘è®¿é—®ï¼šbind-address = å†…ç½‘IPï¼ˆå¹³è¡¡å®‰å…¨å’ŒåŠŸèƒ½ï¼‰
å…¨ç½‘è®¿é—®ï¼šbind-address = 0.0.0.0ï¼ˆéœ€è¦å¼ºåŒ–å…¶ä»–å®‰å…¨æŽªæ–½ï¼‰
```

### 7.3 å®žé™…åº”ç”¨ä»·å€¼


**ðŸ’¼ ç”Ÿäº§çŽ¯å¢ƒé…ç½®æŒ‡å—**
- **ç«¯å£è§„åˆ’**ï¼šåˆ¶å®šä¼ä¸šçº§ç«¯å£åˆ†é…æ ‡å‡†
- **å®‰å…¨ç­–ç•¥**ï¼šå»ºç«‹é˜²ç«å¢™è§„åˆ™ç®¡ç†æµç¨‹
- **ç›‘æŽ§å‘Šè­¦**ï¼šå¯¹ç«¯å£çŠ¶æ€å’Œè¿žæŽ¥å¼‚å¸¸è¿›è¡Œç›‘æŽ§
- **åº”æ€¥é¢„æ¡ˆ**ï¼šåˆ¶å®šç«¯å£å†²çªçš„å¤„ç†æµç¨‹

**ðŸ”§ æ—¥å¸¸è¿ç»´æŠ€èƒ½**
- **ç«¯å£æ£€æµ‹**ï¼šç†Ÿç»ƒä½¿ç”¨netstatã€ssã€lsofç­‰å·¥å…·
- **é˜²ç«å¢™ç®¡ç†**ï¼šæŽŒæ¡iptableså’Œfirewalldçš„ä½¿ç”¨
- **é…ç½®ç®¡ç†**ï¼šç†è§£MySQLé…ç½®æ–‡ä»¶çš„ç«¯å£ç›¸å…³å‚æ•°
- **æ•…éšœæŽ’æŸ¥**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³ç«¯å£ç›¸å…³é—®é¢˜

### 7.4 å¸¸è§è¯¯åŒºæé†’


**âš ï¸ é…ç½®è¯¯åŒº**
```
åªæ”¹ç«¯å£ä¸æ”¹é˜²ç«å¢™ â†’ æœåŠ¡æ— æ³•è®¿é—®
bind-addressé…ç½®é”™è¯¯ â†’ è¿žæŽ¥è¢«æ‹’ç»
å¤šå®žä¾‹ç«¯å£é‡å¤ â†’ å¯åŠ¨å¤±è´¥
å¿˜è®°æ›´æ–°å®¢æˆ·ç«¯é…ç½® â†’ åº”ç”¨è¿žæŽ¥å¤±è´¥
```

**ðŸ’¡ æœ€ä½³å®žè·µå»ºè®®**
```
æ–‡æ¡£è®°å½•ï¼šè¯¦ç»†è®°å½•ç«¯å£åˆ†é…å’Œé…ç½®å˜æ›´
æµ‹è¯•éªŒè¯ï¼šé…ç½®ä¿®æ”¹åŽå……åˆ†æµ‹è¯•
å¤‡ä»½é…ç½®ï¼šä¿®æ”¹å‰å¤‡ä»½åŽŸé…ç½®æ–‡ä»¶
æ¸è¿›å˜æ›´ï¼šç”Ÿäº§çŽ¯å¢ƒåˆ†æ­¥éª¤ä¿®æ”¹é…ç½®
```

### 7.5 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ðŸš€ ç½‘ç»œå®‰å…¨æ–¹å‘**
- **ç«¯å£æ‰«æé˜²æŠ¤**ï¼šfail2banç­‰å·¥å…·çš„ä½¿ç”¨
- **SSL/TLSé…ç½®**ï¼šåŠ å¯†æ•°æ®ä¼ è¾“
- **VPNè®¿é—®**ï¼šé€šè¿‡VPNå®‰å…¨è®¿é—®æ•°æ®åº“
- **ç½‘ç»œéš”ç¦»**ï¼šVLANå’Œå­ç½‘åˆ’åˆ†

**ðŸ—ï¸ æž¶æž„è®¾è®¡æ–¹å‘**
- **è´Ÿè½½å‡è¡¡**ï¼šé€šè¿‡ä»£ç†å±‚åˆ†å‘æ•°æ®åº“è¿žæŽ¥
- **é«˜å¯ç”¨è®¾è®¡**ï¼šå¤šå®žä¾‹æ•…éšœåˆ‡æ¢æœºåˆ¶
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šDockerä¸­çš„MySQLç«¯å£æ˜ å°„
- **äº‘å¹³å°é›†æˆ**ï¼šäº‘çŽ¯å¢ƒä¸­çš„ç½‘ç»œå®‰å…¨ç»„é…ç½®

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç«¯å£å¦‚é—¨ç‰Œï¼ŒæœåŠ¡æœ‰åœ°å€
é»˜è®¤3306é£Žé™©é«˜ï¼Œè‡ªå®šä¹‰ç«¯å£æ›´å®‰å…¨
é˜²ç«å¢™è§„åˆ™è¦ç²¾å‡†ï¼Œåªæ”¾è¡Œå¯ä¿¡IP
å¤šå®žä¾‹ç«¯å£è¦è§„åˆ’ï¼Œé¿å…å†²çªå¥½ç®¡ç†
æ£€æµ‹å·¥å…·è¦ç†Ÿç»ƒï¼Œå†²çªè§£å†³æœ‰æ–¹æ³•
```