---
title: 16ã€MySQLç¯å¢ƒæ ‡å‡†åŒ–ä¸è§„èŒƒ
---
## ğŸ“š ç›®å½•


1. [ç¯å¢ƒæ ‡å‡†åŒ–æ¦‚è¿°](#1-ç¯å¢ƒæ ‡å‡†åŒ–æ¦‚è¿°)
2. [éƒ¨ç½²æ ‡å‡†åŒ–è§„èŒƒ](#2-éƒ¨ç½²æ ‡å‡†åŒ–è§„èŒƒ)
3. [é…ç½®è§„èŒƒåˆ¶å®š](#3-é…ç½®è§„èŒƒåˆ¶å®š)
4. [ç›®å½•ç»“æ„ä¸å‘½åè§„èŒƒ](#4-ç›®å½•ç»“æ„ä¸å‘½åè§„èŒƒ)
5. [å®‰å…¨é…ç½®åŸºçº¿](#5-å®‰å…¨é…ç½®åŸºçº¿)
6. [ç¯å¢ƒéš”ç¦»ä¸ä¸€è‡´æ€§](#6-ç¯å¢ƒéš”ç¦»ä¸ä¸€è‡´æ€§)
7. [åŸºç¡€è®¾æ–½å³ä»£ç IaC](#7-åŸºç¡€è®¾æ–½å³ä»£ç IaC)
8. [é…ç½®ç®¡ç†ä¸ç‰ˆæœ¬æ§åˆ¶](#8-é…ç½®ç®¡ç†ä¸ç‰ˆæœ¬æ§åˆ¶)
9. [ç›‘æ§ä¸åˆè§„æ€§æ£€æŸ¥](#9-ç›‘æ§ä¸åˆè§„æ€§æ£€æŸ¥)
10. [å®æ–½æ–¹æ¡ˆä¸æ£€æŸ¥æ¸…å•](#10-å®æ–½æ–¹æ¡ˆä¸æ£€æŸ¥æ¸…å•)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç¯å¢ƒæ ‡å‡†åŒ–æ¦‚è¿°



### 1.1 ä»€ä¹ˆæ˜¯ç¯å¢ƒæ ‡å‡†åŒ–



**ç®€å•ç†è§£**ï¼šç¯å¢ƒæ ‡å‡†åŒ–å°±æ˜¯è®©ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰çš„MySQLé…ç½®ã€éƒ¨ç½²æ–¹å¼ã€ç›®å½•ç»“æ„ç­‰ä¿æŒä¸€è‡´å’Œè§„èŒƒï¼Œé¿å…"åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘"çš„é—®é¢˜ã€‚

```
æ²¡æœ‰æ ‡å‡†åŒ–çš„é—®é¢˜ï¼š
å¼€å‘ç¯å¢ƒï¼šMySQLç«¯å£3307ï¼Œé…ç½®éšæ„ï¼Œæ•°æ®å­˜å‚¨/tmp
æµ‹è¯•ç¯å¢ƒï¼šMySQLç«¯å£3308ï¼Œé…ç½®ä¸åŒï¼Œæ•°æ®å­˜å‚¨/var/lib  
ç”Ÿäº§ç¯å¢ƒï¼šMySQLç«¯å£3306ï¼Œé«˜å¯ç”¨é…ç½®ï¼Œæ•°æ®å­˜å‚¨/data

ç»“æœï¼šç¯å¢ƒå·®å¼‚å¯¼è‡´é—®é¢˜éš¾ä»¥å¤ç°å’Œå®šä½
```

**æ ‡å‡†åŒ–çš„ä»·å€¼**ï¼š
- **å‡å°‘ç¯å¢ƒå·®å¼‚**ï¼šæ¶ˆé™¤å› ç¯å¢ƒä¸åŒå¯¼è‡´çš„é—®é¢˜
- **æå‡éƒ¨ç½²æ•ˆç‡**ï¼šç»Ÿä¸€çš„éƒ¨ç½²æµç¨‹å’Œé…ç½®æ¨¡æ¿
- **é™ä½ç»´æŠ¤æˆæœ¬**ï¼šç»Ÿä¸€çš„è¿ç»´æ ‡å‡†å’Œç›‘æ§ä½“ç³»
- **æé«˜å®‰å…¨æ€§**ï¼šç»Ÿä¸€çš„å®‰å…¨é…ç½®åŸºçº¿
- **ä¾¿äºé—®é¢˜å®šä½**ï¼šç¯å¢ƒä¸€è‡´æ€§è®©é—®é¢˜æ›´å®¹æ˜“å¤ç°

### 1.2 æ ‡å‡†åŒ–çš„æ ¸å¿ƒåŸåˆ™



**ä¸€è‡´æ€§åŸåˆ™**ï¼š
```
ç¯å¢ƒä¸€è‡´æ€§ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®åŸºæœ¬ä¸€è‡´
é…ç½®ä¸€è‡´æ€§ï¼šç›¸åŒç”¨é€”çš„å®ä¾‹ä½¿ç”¨ç›¸åŒé…ç½®æ¨¡æ¿  
å‘½åä¸€è‡´æ€§ï¼šç»Ÿä¸€çš„å‘½åè§„èŒƒå’Œç›®å½•ç»“æ„
æµç¨‹ä¸€è‡´æ€§ï¼šç»Ÿä¸€çš„éƒ¨ç½²ã€å˜æ›´ã€è¿ç»´æµç¨‹
```

**å¯è¿½æº¯åŸåˆ™**ï¼š
```
é…ç½®å˜æ›´å¯è¿½æº¯ï¼šæ‰€æœ‰é…ç½®å˜æ›´éƒ½æœ‰è®°å½•
ç‰ˆæœ¬å¯å›æ»šï¼šé…ç½®æ–‡ä»¶ç‰ˆæœ¬åŒ–ç®¡ç†
å®¡æ‰¹æµç¨‹ï¼šç¯å¢ƒå˜æ›´éœ€è¦å®¡æ‰¹å’Œè®°å½•
æ–‡æ¡£åŒæ­¥ï¼šé…ç½®å˜æ›´åŠæ—¶æ›´æ–°æ–‡æ¡£
```

**è‡ªåŠ¨åŒ–åŸåˆ™**ï¼š
```
è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šä½¿ç”¨è„šæœ¬æˆ–å·¥å…·è‡ªåŠ¨åŒ–éƒ¨ç½²
è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼šè‡ªåŠ¨æ£€æµ‹é…ç½®æ¼‚ç§»å’Œåˆè§„æ€§
è‡ªåŠ¨åŒ–ç›‘æ§ï¼šæ ‡å‡†åŒ–çš„ç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦
è‡ªåŠ¨åŒ–è¿ç»´ï¼šæ ‡å‡†åŒ–çš„è¿ç»´æ“ä½œè„šæœ¬
```

---

## 2. ğŸš€ éƒ¨ç½²æ ‡å‡†åŒ–è§„èŒƒ



### 2.1 æ ‡å‡†åŒ–éƒ¨ç½²æ¨¡æ¿



**åŸºç¡€éƒ¨ç½²æ¨¡æ¿ç»“æ„**ï¼š
```yaml
# MySQLéƒ¨ç½²æ ‡å‡†æ¨¡æ¿

mysql_deployment_template:
  version: "8.0.33"
  port: 3306                    # ç«¯å£æ ‡å‡†åŒ–
  socket: /var/lib/mysql/mysql.sock
  datadir: /var/lib/mysql
  basedir: /usr/local/mysql
  user: mysql
  group: mysql
  
#  # æ ‡å‡†é…ç½®æ–‡ä»¶è·¯å¾„
  config_files:
    main_config: /etc/mysql/my.cnf
    error_log: /var/log/mysql/error.log
    slow_log: /var/log/mysql/slow.log
    binary_log: /var/log/mysql/binlog
    
#  # æ ‡å‡†åŒ–ç›®å½•ç»“æ„
  directories:
    - path: /var/lib/mysql
      owner: mysql
      group: mysql  
      mode: "0750"
    - path: /var/log/mysql
      owner: mysql
      group: mysql
      mode: "0750"
    - path: /etc/mysql
      owner: root
      group: mysql
      mode: "0640"
```

### 2.2 ç¯å¢ƒç±»å‹æ ‡å‡†åŒ–



**ç¯å¢ƒåˆ†ç±»ä¸é…ç½®å·®å¼‚**ï¼š
```
å¼€å‘ç¯å¢ƒ(dev)ï¼š
â”œâ”€ å®ä¾‹æ ‡è¯†ï¼šmysql-dev-{project}-{instance_id}
â”œâ”€ ç«¯å£èŒƒå›´ï¼š3306
â”œâ”€ èµ„æºé…ç½®ï¼š2C4Gï¼Œå­˜å‚¨100GB
â”œâ”€ é«˜å¯ç”¨ï¼šå•å®ä¾‹ï¼Œæ— ä¸»ä»
â””â”€ å¤‡ä»½ç­–ç•¥ï¼šæ¯æ—¥é€»è¾‘å¤‡ä»½

æµ‹è¯•ç¯å¢ƒ(test)ï¼š  
â”œâ”€ å®ä¾‹æ ‡è¯†ï¼šmysql-test-{project}-{instance_id}
â”œâ”€ ç«¯å£èŒƒå›´ï¼š3306
â”œâ”€ èµ„æºé…ç½®ï¼š4C8Gï¼Œå­˜å‚¨200GB  
â”œâ”€ é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶
â””â”€ å¤‡ä»½ç­–ç•¥ï¼šæ¯æ—¥ç‰©ç†å¤‡ä»½ + é€»è¾‘å¤‡ä»½

é¢„ç”Ÿäº§ç¯å¢ƒ(staging)ï¼š
â”œâ”€ å®ä¾‹æ ‡è¯†ï¼šmysql-staging-{project}-{instance_id}
â”œâ”€ ç«¯å£èŒƒå›´ï¼š3306
â”œâ”€ èµ„æºé…ç½®ï¼šä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´
â”œâ”€ é«˜å¯ç”¨ï¼šä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´
â””â”€ å¤‡ä»½ç­–ç•¥ï¼šä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´

ç”Ÿäº§ç¯å¢ƒ(prod)ï¼š
â”œâ”€ å®ä¾‹æ ‡è¯†ï¼šmysql-prod-{project}-{instance_id}  
â”œâ”€ ç«¯å£èŒƒå›´ï¼š3306
â”œâ”€ èµ„æºé…ç½®ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é…ç½®
â”œâ”€ é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶ + MHA/MGR
â””â”€ å¤‡ä»½ç­–ç•¥ï¼šå®æ—¶å¤‡ä»½ + å®šæœŸå…¨å¤‡
```

### 2.3 éƒ¨ç½²æµç¨‹æ ‡å‡†åŒ–



**æ ‡å‡†éƒ¨ç½²æµç¨‹**ï¼š
```
éƒ¨ç½²æµç¨‹ï¼š
1. ç¯å¢ƒå‡†å¤‡é˜¶æ®µ
   â”œâ”€ æœåŠ¡å™¨èµ„æºç”³è¯·å’Œé…ç½®
   â”œâ”€ æ“ä½œç³»ç»Ÿæ ‡å‡†åŒ–é…ç½®  
   â”œâ”€ ç½‘ç»œå’Œå®‰å…¨ç»„é…ç½®
   â””â”€ ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿé›†æˆ

2. MySQLå®‰è£…é˜¶æ®µ  
   â”œâ”€ ä½¿ç”¨æ ‡å‡†åŒ–å®‰è£…åŒ…
   â”œâ”€ æŒ‰ç…§æ ‡å‡†ç›®å½•ç»“æ„åˆ›å»º
   â”œâ”€ é…ç½®æ ‡å‡†åŒ–çš„my.cnf
   â””â”€ åˆå§‹åŒ–æ•°æ®åº“å’Œè´¦æˆ·

3. é…ç½®éªŒè¯é˜¶æ®µ
   â”œâ”€ é…ç½®åˆè§„æ€§æ£€æŸ¥
   â”œâ”€ å®‰å…¨é…ç½®åŸºçº¿éªŒè¯
   â”œâ”€ æ€§èƒ½å‚æ•°éªŒè¯
   â””â”€ ç›‘æ§æŒ‡æ ‡éªŒè¯

4. æœåŠ¡å¯åŠ¨é˜¶æ®µ
   â”œâ”€ å¯åŠ¨MySQLæœåŠ¡
   â”œâ”€ éªŒè¯æœåŠ¡çŠ¶æ€
   â”œâ”€ æ‰§è¡Œè¿æ¥æµ‹è¯•
   â””â”€ è¿è¡Œå¥åº·æ£€æŸ¥

5. äº¤ä»˜é˜¶æ®µ
   â”œâ”€ æ›´æ–°CMDBä¿¡æ¯
   â”œâ”€ äº¤ä»˜ä½¿ç”¨æ–‡æ¡£
   â”œâ”€ åŸ¹è®­ç›¸å…³äººå‘˜
   â””â”€ å»ºç«‹ç›‘æ§å‘Šè­¦
```

**éƒ¨ç½²æ£€æŸ¥æ¸…å•**ï¼š
```markdown
# MySQLéƒ¨ç½²æ£€æŸ¥æ¸…å•



## ç³»ç»Ÿå±‚é¢æ£€æŸ¥


- [ ] æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç¬¦åˆæ ‡å‡†ï¼ˆCentOS 7.x / Ubuntu 18.04+ï¼‰
- [ ] ç³»ç»Ÿæ—¶é—´åŒæ­¥é…ç½®ï¼ˆNTPï¼‰
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®ï¼ˆä»…å¼€æ”¾å¿…è¦ç«¯å£ï¼‰
- [ ] SELinuxé…ç½®ï¼ˆå»ºè®®disabledæˆ–permissiveï¼‰
- [ ] ç³»ç»Ÿå‚æ•°è°ƒä¼˜ï¼ˆulimitã€vmå‚æ•°ç­‰ï¼‰

## MySQLå®‰è£…æ£€æŸ¥  


- [ ] MySQLç‰ˆæœ¬ç¬¦åˆæ ‡å‡†ï¼ˆ8.0.33ï¼‰
- [ ] å®‰è£…è·¯å¾„ç¬¦åˆè§„èŒƒï¼ˆ/usr/local/mysqlï¼‰
- [ ] æ•°æ®ç›®å½•ç¬¦åˆè§„èŒƒï¼ˆ/var/lib/mysqlï¼‰
- [ ] æ—¥å¿—ç›®å½•ç¬¦åˆè§„èŒƒï¼ˆ/var/log/mysqlï¼‰
- [ ] é…ç½®æ–‡ä»¶è·¯å¾„ç¬¦åˆè§„èŒƒï¼ˆ/etc/mysql/my.cnfï¼‰

## é…ç½®æ–‡ä»¶æ£€æŸ¥


- [ ] åŸºç¡€é…ç½®ç¬¦åˆæ¨¡æ¿è¦æ±‚
- [ ] å®‰å…¨é…ç½®ç¬¦åˆåŸºçº¿è¦æ±‚
- [ ] æ€§èƒ½é…ç½®ç¬¦åˆç¯å¢ƒè¦æ±‚  
- [ ] æ—¥å¿—é…ç½®ç¬¦åˆå®¡è®¡è¦æ±‚
- [ ] å¤åˆ¶é…ç½®ç¬¦åˆé«˜å¯ç”¨è¦æ±‚

## æƒé™å’Œå®‰å…¨æ£€æŸ¥


- [ ] rootå¯†ç ç¬¦åˆå¤æ‚åº¦è¦æ±‚
- [ ] åˆ é™¤æµ‹è¯•è´¦æˆ·å’Œæ•°æ®åº“
- [ ] ä¸šåŠ¡è´¦æˆ·æƒé™æœ€å°åŒ–åŸåˆ™
- [ ] SSLè¯ä¹¦é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] å®¡è®¡æ—¥å¿—é…ç½®

## æœåŠ¡å’Œç›‘æ§æ£€æŸ¥


- [ ] MySQLæœåŠ¡è‡ªå¯åŠ¨é…ç½®
- [ ] ç›‘æ§agentå®‰è£…å’Œé…ç½®
- [ ] å‘Šè­¦è§„åˆ™é…ç½®
- [ ] å¤‡ä»½è„šæœ¬é…ç½®å’Œæµ‹è¯•
- [ ] æ—¥å¿—è½®è½¬é…ç½®
```

---

## 3. âš™ï¸ é…ç½®è§„èŒƒåˆ¶å®š



### 3.1 åŸºç¡€é…ç½®è§„èŒƒ



**æ ‡å‡†my.cnfæ¨¡æ¿**ï¼š
```ini
[mysqld]
# åŸºç¡€é…ç½®æ ‡å‡†åŒ–

port = 3306
socket = /var/lib/mysql/mysql.sock
datadir = /var/lib/mysql
basedir = /usr/local/mysql
user = mysql
pid-file = /var/run/mysqld/mysqld.pid

# å­—ç¬¦é›†æ ‡å‡†åŒ–ï¼ˆç»Ÿä¸€UTF8MB4ï¼‰

character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init_connect = 'SET NAMES utf8mb4'

# InnoDBåŸºç¡€é…ç½®

default-storage-engine = INNODB
innodb_file_per_table = ON
innodb_flush_log_at_trx_commit = 1
innodb_log_buffer_size = 16M
innodb_log_file_size = 256M
innodb_log_files_in_group = 2

# è¿æ¥é…ç½®æ ‡å‡†åŒ–

max_connections = 1000
max_connect_errors = 1000000
max_allowed_packet = 64M
interactive_timeout = 1800
wait_timeout = 1800

# æŸ¥è¯¢ç¼“å­˜é…ç½®ï¼ˆ8.0å·²åºŸå¼ƒï¼Œä¿ç•™ç”¨äº5.7å…¼å®¹ï¼‰

# query_cache_size = 0

# query_cache_type = 0


# æ—¥å¿—é…ç½®æ ‡å‡†åŒ–

log-error = /var/log/mysql/error.log
slow_query_log = ON
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 1
log_queries_not_using_indexes = ON

# äºŒè¿›åˆ¶æ—¥å¿—é…ç½®

log-bin = /var/log/mysql/binlog
binlog_format = ROW
binlog_row_image = FULL
expire_logs_days = 7
max_binlog_size = 100M

# å®‰å…¨é…ç½®

skip-name-resolve = ON
sql_mode = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION

[mysql]
default-character-set = utf8mb4
socket = /var/lib/mysql/mysql.sock

[mysqldump]
default-character-set = utf8mb4
single-transaction
routines
triggers
```

### 3.2 ç¯å¢ƒå·®å¼‚åŒ–é…ç½®



**ä¸åŒç¯å¢ƒçš„é…ç½®å·®å¼‚**ï¼š
```ini
# å¼€å‘ç¯å¢ƒé…ç½®è°ƒæ•´

[mysqld-dev]
innodb_buffer_pool_size = 1G          # è¾ƒå°çš„ç¼“å†²æ± 
innodb_flush_log_at_trx_commit = 2     # æ€§èƒ½ä¼˜å…ˆ
sync_binlog = 0                        # å…³é—­å®æ—¶åŒæ­¥
slow_query_log = ON                    # å¼€å¯æ…¢æŸ¥è¯¢ç”¨äºè°ƒè¯•
log_queries_not_using_indexes = ON     # è®°å½•æ— ç´¢å¼•æŸ¥è¯¢

# æµ‹è¯•ç¯å¢ƒé…ç½®è°ƒæ•´  

[mysqld-test]
innodb_buffer_pool_size = 2G          # ä¸­ç­‰ç¼“å†²æ± 
innodb_flush_log_at_trx_commit = 1     # å¹³è¡¡æ€§èƒ½å’Œå®‰å…¨
sync_binlog = 1                        # å¼€å¯åŒæ­¥
general_log = ON                       # å¯èƒ½éœ€è¦å¼€å¯é€šç”¨æ—¥å¿—
general_log_file = /var/log/mysql/general.log

# ç”Ÿäº§ç¯å¢ƒé…ç½®è°ƒæ•´

[mysqld-prod]  
innodb_buffer_pool_size = 8G          # å¤§ç¼“å†²æ± ï¼ˆç‰©ç†å†…å­˜çš„70-80%ï¼‰
innodb_flush_log_at_trx_commit = 1     # æ•°æ®å®‰å…¨ä¼˜å…ˆ
sync_binlog = 1                        # å¼ºåˆ¶åŒæ­¥
performance_schema = ON                # å¼€å¯æ€§èƒ½ç›‘æ§
innodb_monitor_enable = all            # å¼€å¯è¯¦ç»†ç›‘æ§
```

### 3.3 é…ç½®å‚æ•°æ ‡å‡†åŒ–



**é‡è¦å‚æ•°æ ‡å‡†åŒ–è¯´æ˜**ï¼š
```yaml
# MySQLé…ç½®å‚æ•°æ ‡å‡†åŒ–

mysql_config_standards:
  
#  # ç«¯å£æ ‡å‡†åŒ–
  port_standards:
    mysql_port: 3306              # ä¸»ç«¯å£å›ºå®š3306
    admin_port: 33062             # ç®¡ç†ç«¯å£ï¼ˆMySQL 8.0ï¼‰
    mysqlx_port: 33060           # Xåè®®ç«¯å£
    
#  # å­—ç¬¦é›†æ ‡å‡†åŒ–
  charset_standards:
    character_set: utf8mb4        # ç»Ÿä¸€å­—ç¬¦é›†
    collation: utf8mb4_unicode_ci # ç»Ÿä¸€æ’åºè§„åˆ™
    
#  # å­˜å‚¨å¼•æ“æ ‡å‡†åŒ–  
  engine_standards:
    default_engine: InnoDB        # é»˜è®¤å­˜å‚¨å¼•æ“
    disabled_engines:             # ç¦ç”¨çš„å¼•æ“
      - MyISAM
      - Memory
      - CSV
      
#  # æ—¥å¿—é…ç½®æ ‡å‡†åŒ–
  log_standards:
    error_log: /var/log/mysql/error.log
    slow_log: /var/log/mysql/slow.log
    general_log: OFF              # ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­
    binlog_format: ROW           # ç»Ÿä¸€äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼
    
#  # å®‰å…¨é…ç½®æ ‡å‡†åŒ–
  security_standards:
    skip_name_resolve: ON         # è·³è¿‡DNSè§£æ
    local_infile: OFF            # ç¦ç”¨LOAD DATA LOCAL INFILE
    secure_file_priv: /var/lib/mysql-files  # é™åˆ¶æ–‡ä»¶æ“ä½œç›®å½•
```

---

## 4. ğŸ“ ç›®å½•ç»“æ„ä¸å‘½åè§„èŒƒ



### 4.1 æ ‡å‡†ç›®å½•ç»“æ„



**MySQLæ ‡å‡†ç›®å½•å¸ƒå±€**ï¼š
```
/usr/local/mysql/                    # MySQLç¨‹åºç›®å½•
â”œâ”€â”€ bin/                            # å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ lib/                            # åº“æ–‡ä»¶
â”œâ”€â”€ share/                          # å…±äº«æ–‡ä»¶
â””â”€â”€ support-files/                  # æ”¯æŒæ–‡ä»¶

/var/lib/mysql/                     # æ•°æ®ç›®å½•
â”œâ”€â”€ {database_name}/                # ä¸šåŠ¡æ•°æ®åº“ç›®å½•
â”œâ”€â”€ mysql/                          # ç³»ç»Ÿæ•°æ®åº“
â”œâ”€â”€ performance_schema/             # æ€§èƒ½æ¨¡å¼æ•°æ®
â”œâ”€â”€ sys/                           # ç³»ç»Ÿæ•°æ®åº“
â”œâ”€â”€ ib_logfile0                    # InnoDBæ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ ib_logfile1                    # InnoDBæ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ ibdata1                        # InnoDBç³»ç»Ÿè¡¨ç©ºé—´
â”œâ”€â”€ mysql.sock                     # Socketæ–‡ä»¶
â””â”€â”€ auto.cnf                       # æœåŠ¡å™¨UUID

/var/log/mysql/                     # æ—¥å¿—ç›®å½•
â”œâ”€â”€ error.log                      # é”™è¯¯æ—¥å¿—
â”œâ”€â”€ slow.log                       # æ…¢æŸ¥è¯¢æ—¥å¿—
â”œâ”€â”€ binlog.000001                  # äºŒè¿›åˆ¶æ—¥å¿—
â”œâ”€â”€ binlog.000002                  
â”œâ”€â”€ binlog.index                   # äºŒè¿›åˆ¶æ—¥å¿—ç´¢å¼•
â””â”€â”€ relay.log                      # ä¸­ç»§æ—¥å¿—(ä»åº“)

/etc/mysql/                         # é…ç½®ç›®å½•
â”œâ”€â”€ my.cnf                         # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ mysql.conf.d/                  # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ mysql.cnf                  # MySQLå®¢æˆ·ç«¯é…ç½®
â”‚   â””â”€â”€ mysqldump.cnf              # mysqldumpé…ç½®
â””â”€â”€ conf.d/                        # é¢å¤–é…ç½®ç›®å½•

/var/run/mysqld/                    # è¿è¡Œæ—¶ç›®å½•
â”œâ”€â”€ mysqld.pid                     # è¿›ç¨‹IDæ–‡ä»¶
â””â”€â”€ mysqld.sock                    # Socketæ–‡ä»¶é“¾æ¥

/opt/mysql/                         # æ‰©å±•ç›®å½•
â”œâ”€â”€ backup/                        # å¤‡ä»½è„šæœ¬å’Œæ–‡ä»¶
â”œâ”€â”€ scripts/                       # è¿ç»´è„šæœ¬
â”œâ”€â”€ ssl/                           # SSLè¯ä¹¦
â””â”€â”€ tools/                         # å·¥å…·æ–‡ä»¶
```

### 4.2 å‘½åè§„åˆ™çº¦å®š



**å®ä¾‹å‘½åè§„èŒƒ**ï¼š
```
å®ä¾‹å‘½åæ ¼å¼ï¼šmysql-{env}-{project}-{function}-{instance_id}

ç¤ºä¾‹ï¼š
mysql-prod-ecommerce-master-001     # ç”Ÿäº§ç¯å¢ƒç”µå•†é¡¹ç›®ä¸»åº“1å·
mysql-prod-ecommerce-slave-001      # ç”Ÿäº§ç¯å¢ƒç”µå•†é¡¹ç›®ä»åº“1å·  
mysql-test-crm-master-001          # æµ‹è¯•ç¯å¢ƒCRMé¡¹ç›®ä¸»åº“1å·
mysql-dev-blog-single-001          # å¼€å‘ç¯å¢ƒåšå®¢é¡¹ç›®å•ä¾‹1å·

å‘½åå…ƒç´ è¯´æ˜ï¼š
â”œâ”€ env: ç¯å¢ƒæ ‡è¯†(prod/test/dev/staging)
â”œâ”€ project: é¡¹ç›®åç§°(ecommerce/crm/blogç­‰)  
â”œâ”€ function: åŠŸèƒ½è§’è‰²(master/slave/single)
â””â”€ instance_id: å®ä¾‹ç¼–å·(001/002/003ç­‰)
```

**æ•°æ®åº“å‘½åè§„èŒƒ**ï¼š
```
æ•°æ®åº“å‘½åæ ¼å¼ï¼š{project}_{module}_{env}

ç¤ºä¾‹ï¼š
ecommerce_order_prod               # ç”µå•†è®¢å•ç”Ÿäº§åº“
ecommerce_user_prod                # ç”µå•†ç”¨æˆ·ç”Ÿäº§åº“
crm_customer_test                  # CRMå®¢æˆ·æµ‹è¯•åº“
blog_content_dev                   # åšå®¢å†…å®¹å¼€å‘åº“

å‘½åè§„åˆ™ï¼š
â”œâ”€ ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
â”œâ”€ ä¸ä½¿ç”¨MySQLä¿ç•™å­—
â”œâ”€ é•¿åº¦ä¸è¶…è¿‡64å­—ç¬¦
â””â”€ è§åçŸ¥æ„ï¼Œè¡¨è¾¾ä¸šåŠ¡å«ä¹‰
```

**è¡¨å‘½åè§„èŒƒ**ï¼š
```
è¡¨å‘½åæ ¼å¼ï¼š{module}_{entity}

ç¤ºä¾‹ï¼š
order_main                         # è®¢å•ä¸»è¡¨
order_detail                       # è®¢å•æ˜ç»†è¡¨
user_profile                       # ç”¨æˆ·èµ„æ–™è¡¨
product_category                   # äº§å“åˆ†ç±»è¡¨

å‘½åè§„åˆ™ï¼š
â”œâ”€ ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿åˆ†éš”
â”œâ”€ è¡¨ååº”ä¸ºå¤æ•°å½¢å¼æˆ–åŠ _liståç¼€
â”œâ”€ ä¸ä½¿ç”¨MySQLä¿ç•™å­—å’Œå…³é”®å­—
â”œâ”€ é•¿åº¦æ§åˆ¶åœ¨30å­—ç¬¦ä»¥å†…
â””â”€ ç»Ÿä¸€å‰ç¼€è¡¨ç¤ºæ‰€å±æ¨¡å—
```

### 4.3 æ–‡ä»¶å’Œç›®å½•æƒé™æ ‡å‡†



**æ ‡å‡†æƒé™è®¾ç½®**ï¼š
```bash
# ç›®å½•æƒé™è®¾ç½®è„šæœ¬

#!/bin/bash


# MySQLç¨‹åºç›®å½•æƒé™

chown -R root:mysql /usr/local/mysql
chmod -R 755 /usr/local/mysql
chmod -R +x /usr/local/mysql/bin/*

# æ•°æ®ç›®å½•æƒé™  

chown -R mysql:mysql /var/lib/mysql
chmod 750 /var/lib/mysql
chmod 640 /var/lib/mysql/*

# æ—¥å¿—ç›®å½•æƒé™

chown -R mysql:mysql /var/log/mysql  
chmod 750 /var/log/mysql
chmod 640 /var/log/mysql/*.log

# é…ç½®ç›®å½•æƒé™

chown -R root:mysql /etc/mysql
chmod 644 /etc/mysql/my.cnf
chmod 750 /etc/mysql
chmod 640 /etc/mysql/mysql.conf.d/*

# è¿è¡Œæ—¶ç›®å½•æƒé™

chown -R mysql:mysql /var/run/mysqld
chmod 755 /var/run/mysqld

# æ‰©å±•ç›®å½•æƒé™  

chown -R mysql:mysql /opt/mysql
chmod 750 /opt/mysql
chmod +x /opt/mysql/scripts/*.sh
```

---

## 5. ğŸ”’ å®‰å…¨é…ç½®åŸºçº¿



### 5.1 è´¦æˆ·å®‰å…¨æ ‡å‡†



**ç”¨æˆ·æƒé™æ ‡å‡†åŒ–é…ç½®**ï¼š
```sql
-- æ ‡å‡†åŒ–ç”¨æˆ·æƒé™é…ç½®

-- 1. åˆ é™¤é»˜è®¤çš„ä¸å®‰å…¨è´¦æˆ·
DROP USER IF EXISTS ''@'localhost';
DROP USER IF EXISTS ''@'%';
DROP USER IF EXISTS 'root'@'%';
DELETE FROM mysql.user WHERE User='';
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');

-- 2. åˆ›å»ºæ ‡å‡†åŒ–çš„ç®¡ç†ç”¨æˆ·
CREATE USER 'admin'@'localhost' IDENTIFIED BY 'ComplexPassword@123';
GRANT ALL PRIVILEGES ON *.* TO 'admin'@'localhost' WITH GRANT OPTION;

-- 3. åˆ›å»ºæ ‡å‡†åŒ–çš„åº”ç”¨ç”¨æˆ·ï¼ˆæœ€å°æƒé™åŸåˆ™ï¼‰
CREATE USER 'app_readonly'@'%' IDENTIFIED BY 'ReadOnlyPass@123';
GRANT SELECT ON application_db.* TO 'app_readonly'@'%';

CREATE USER 'app_readwrite'@'%' IDENTIFIED BY 'ReadWritePass@123';  
GRANT SELECT, INSERT, UPDATE, DELETE ON application_db.* TO 'app_readwrite'@'%';

-- 4. åˆ›å»ºå¤‡ä»½ä¸“ç”¨ç”¨æˆ·
CREATE USER 'backup_user'@'localhost' IDENTIFIED BY 'BackupPass@123';
GRANT SELECT, RELOAD, SHOW DATABASES, LOCK TABLES, REPLICATION CLIENT ON *.* TO 'backup_user'@'localhost';

-- 5. åˆ›å»ºç›‘æ§ç”¨æˆ·
CREATE USER 'monitor_user'@'%' IDENTIFIED BY 'MonitorPass@123';
GRANT SELECT, PROCESS, REPLICATION CLIENT ON *.* TO 'monitor_user'@'%';

FLUSH PRIVILEGES;
```

### 5.2 å¯†ç ç­–ç•¥æ ‡å‡†



**å¯†ç å¤æ‚åº¦è¦æ±‚**ï¼š
```sql
-- å®‰è£…å¯†ç éªŒè¯æ’ä»¶
INSTALL PLUGIN validate_password SONAME 'validate_password.so';

-- å¯†ç ç­–ç•¥é…ç½®
SET GLOBAL validate_password.policy = 'MEDIUM';
SET GLOBAL validate_password.length = 12;
SET GLOBAL validate_password.mixed_case_count = 1;
SET GLOBAL validate_password.number_count = 1;  
SET GLOBAL validate_password.special_char_count = 1;

-- å†™å…¥é…ç½®æ–‡ä»¶æ°¸ä¹…ç”Ÿæ•ˆ
[mysqld]
validate_password.policy = MEDIUM
validate_password.length = 12
validate_password.mixed_case_count = 1
validate_password.number_count = 1
validate_password.special_char_count = 1
```

**å¯†ç ç®¡ç†è§„èŒƒ**ï¼š
```yaml
password_policy:
  complexity_requirements:
    min_length: 12                # æœ€å°é•¿åº¦12ä½
    uppercase: 1                  # è‡³å°‘1ä¸ªå¤§å†™å­—æ¯
    lowercase: 1                  # è‡³å°‘1ä¸ªå°å†™å­—æ¯  
    numbers: 1                    # è‡³å°‘1ä¸ªæ•°å­—
    special_chars: 1              # è‡³å°‘1ä¸ªç‰¹æ®Šå­—ç¬¦
    
  password_lifecycle:
    max_age_days: 90             # å¯†ç æœ€é•¿ä½¿ç”¨90å¤©
    history_count: 5             # è®°ä½æœ€è¿‘5æ¬¡å¯†ç 
    lockout_attempts: 5          # 5æ¬¡å¤±è´¥åé”å®š
    lockout_duration: 1800       # é”å®š30åˆ†é’Ÿ
    
  account_management:
    inactive_days: 30            # 30å¤©æœªä½¿ç”¨è´¦æˆ·ç¦ç”¨
    admin_review_days: 7         # ç®¡ç†å‘˜è´¦æˆ·7å¤©å®¡æŸ¥ä¸€æ¬¡
    service_account_rotation: 30  # æœåŠ¡è´¦æˆ·30å¤©è½®æ¢
```

### 5.3 ç½‘ç»œå®‰å…¨é…ç½®



**ç½‘ç»œè®¿é—®æ§åˆ¶**ï¼š
```ini
# my.cnfç½‘ç»œå®‰å…¨é…ç½®

[mysqld]
# ç»‘å®šæŒ‡å®šIPï¼ˆä¸è¦ä½¿ç”¨0.0.0.0ï¼‰

bind-address = 192.168.1.100

# è·³è¿‡DNSè§£ææé«˜å®‰å…¨æ€§

skip-name-resolve = ON

# ç¦ç”¨ä¸å®‰å…¨çš„åŠŸèƒ½

local-infile = OFF
secure-file-priv = /var/lib/mysql-files

# SSLé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ï¼‰

ssl-ca = /opt/mysql/ssl/ca.pem
ssl-cert = /opt/mysql/ssl/server-cert.pem  
ssl-key = /opt/mysql/ssl/server-key.pem
require_secure_transport = ON

# é™åˆ¶è¿æ¥æ•°å’Œè¶…æ—¶

max_connections = 1000
max_connect_errors = 10
max_user_connections = 50
```

**é˜²ç«å¢™è§„åˆ™æ¨¡æ¿**ï¼š
```bash
#!/bin/bash

# MySQLé˜²ç«å¢™è§„åˆ™é…ç½®


# æ¸…ç©ºç°æœ‰è§„åˆ™

iptables -F

# å…è®¸æœ¬åœ°å›ç¯

iptables -A INPUT -i lo -j ACCEPT

# å…è®¸å·²å»ºç«‹çš„è¿æ¥

iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# å…è®¸ç‰¹å®šIPè®¿é—®MySQLç«¯å£

iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 3306 -j ACCEPT
iptables -A INPUT -p tcp -s 10.0.0.0/8 --dport 3306 -j ACCEPT

# å…è®¸SSHè®¿é—®ï¼ˆç®¡ç†éœ€è¦ï¼‰

iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# æ‹’ç»å…¶ä»–æ‰€æœ‰è¿æ¥

iptables -A INPUT -j DROP

# ä¿å­˜è§„åˆ™

service iptables save
```

### 5.4 å®¡è®¡æ—¥å¿—é…ç½®



**å®¡è®¡æ—¥å¿—æ ‡å‡†é…ç½®**ï¼š
```sql
-- å®‰è£…å®¡è®¡æ’ä»¶
INSTALL PLUGIN audit_log SONAME 'audit_log.so';

-- å®¡è®¡é…ç½®
SET GLOBAL audit_log_file = '/var/log/mysql/audit.log';
SET GLOBAL audit_log_policy = 'ALL';
SET GLOBAL audit_log_format = 'JSON';
SET GLOBAL audit_log_rotate_on_size = 100000000;  -- 100MBè½®è½¬
```

```ini
# my.cnfå®¡è®¡é…ç½®

[mysqld]
plugin-load-add = audit_log.so
audit_log_file = /var/log/mysql/audit.log
audit_log_policy = ALL
audit_log_format = JSON
audit_log_rotate_on_size = 100000000
audit_log_rotations = 10

# è®°å½•çš„äº‹ä»¶ç±»å‹

audit_log_include_accounts = 'admin@localhost,app_user@%'
audit_log_exclude_accounts = 'monitor_user@%'
```

---

## 6. ğŸ—ï¸ ç¯å¢ƒéš”ç¦»ä¸ä¸€è‡´æ€§



### 6.1 å¼€å‘æµ‹è¯•ç”Ÿäº§ç¯å¢ƒéš”ç¦»



**ç½‘ç»œéš”ç¦»æ–¹æ¡ˆ**ï¼š
```
ç½‘ç»œéš”ç¦»æ¶æ„ï¼š
å¼€å‘ç¯å¢ƒç½‘æ®µï¼š192.168.10.0/24
â”œâ”€ MySQLå¼€å‘å®ä¾‹ï¼š192.168.10.100-110
â”œâ”€ åº”ç”¨æœåŠ¡å™¨ï¼š192.168.10.200-210  
â””â”€ å¼€å‘äººå‘˜è®¿é—®ï¼šVPNæ¥å…¥

æµ‹è¯•ç¯å¢ƒç½‘æ®µï¼š192.168.20.0/24
â”œâ”€ MySQLæµ‹è¯•å®ä¾‹ï¼š192.168.20.100-110
â”œâ”€ åº”ç”¨æœåŠ¡å™¨ï¼š192.168.20.200-210
â””â”€ æµ‹è¯•å›¢é˜Ÿè®¿é—®ï¼šå ¡å’æœºæ¥å…¥

ç”Ÿäº§ç¯å¢ƒç½‘æ®µï¼š172.16.0.0/16  
â”œâ”€ MySQLç”Ÿäº§å®ä¾‹ï¼š172.16.1.100-110
â”œâ”€ åº”ç”¨æœåŠ¡å™¨ï¼š172.16.2.100-200
â””â”€ è¿ç»´è®¿é—®ï¼šä¸“ç”¨VPN + å ¡å’æœº
```

**ç¯å¢ƒéš”ç¦»æ£€æŸ¥æ¸…å•**ï¼š
```markdown
# ç¯å¢ƒéš”ç¦»æ£€æŸ¥æ¸…å•



## ç½‘ç»œéš”ç¦»æ£€æŸ¥


- [ ] ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒç½‘æ®µ
- [ ] ç”Ÿäº§ç¯å¢ƒç½‘ç»œä¸å¼€å‘/æµ‹è¯•ç¯å¢ƒç‰©ç†éš”ç¦»
- [ ] é˜²ç«å¢™è§„åˆ™é™åˆ¶è·¨ç¯å¢ƒè®¿é—®
- [ ] VPNè®¿é—®æƒé™æŒ‰ç¯å¢ƒåˆ†é…
- [ ] å ¡å’æœºé…ç½®ç¯å¢ƒè®¿é—®æ§åˆ¶

## æ•°æ®éš”ç¦»æ£€æŸ¥  


- [ ] ä¸åŒç¯å¢ƒä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“å®ä¾‹
- [ ] ç”Ÿäº§æ•°æ®ä¸èƒ½ç›´æ¥åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨
- [ ] æµ‹è¯•æ•°æ®è„±æ•å¤„ç†
- [ ] æ•°æ®å¤‡ä»½æŒ‰ç¯å¢ƒåˆ†åˆ«å­˜å‚¨
- [ ] æ•°æ®æ¢å¤æ¼”ç»ƒåœ¨å¯¹åº”ç¯å¢ƒè¿›è¡Œ

## è´¦æˆ·éš”ç¦»æ£€æŸ¥


- [ ] ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ•°æ®åº“è´¦æˆ·
- [ ] ç”Ÿäº§ç¯å¢ƒè´¦æˆ·æƒé™æœ€å°åŒ–  
- [ ] å¼€å‘ç¯å¢ƒè´¦æˆ·ä¸èƒ½è®¿é—®ç”Ÿäº§æ•°æ®
- [ ] æœåŠ¡è´¦æˆ·æŒ‰ç¯å¢ƒåˆ†åˆ«åˆ›å»º
- [ ] å¯†ç ç­–ç•¥æŒ‰ç¯å¢ƒå®‰å…¨ç­‰çº§è®¾ç½®

## é…ç½®éš”ç¦»æ£€æŸ¥


- [ ] é…ç½®æ–‡ä»¶æŒ‰ç¯å¢ƒåˆ†åˆ«ç®¡ç†
- [ ] æ•æ„Ÿé…ç½®ä¿¡æ¯åŠ å¯†å­˜å‚¨
- [ ] é…ç½®å˜æ›´æŒ‰ç¯å¢ƒåˆ†åˆ«å®¡æ‰¹
- [ ] é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
- [ ] é…ç½®åŒæ­¥æœºåˆ¶å»ºç«‹
```

### 6.2 ç¯å¢ƒä¸€è‡´æ€§ä¿è¯æœºåˆ¶



**é…ç½®ä¸€è‡´æ€§æ£€æµ‹è„šæœ¬**ï¼š
```bash
#!/bin/bash

# MySQLç¯å¢ƒä¸€è‡´æ€§æ£€æµ‹è„šæœ¬


check_mysql_consistency() {
    local env1=$1
    local env2=$2
    
    echo "æ£€æµ‹ $env1 å’Œ $env2 ç¯å¢ƒä¸€è‡´æ€§..."
    
#    # 1. æ£€æŸ¥MySQLç‰ˆæœ¬ä¸€è‡´æ€§
    version1=$(mysql -h$env1 -e "SELECT VERSION()" -s -N)
    version2=$(mysql -h$env2 -e "SELECT VERSION()" -s -N)
    
    if [ "$version1" != "$version2" ]; then
        echo "âŒ MySQLç‰ˆæœ¬ä¸ä¸€è‡´: $env1($version1) vs $env2($version2)"
    else
        echo "âœ… MySQLç‰ˆæœ¬ä¸€è‡´: $version1"
    fi
    
#    # 2. æ£€æŸ¥å­—ç¬¦é›†é…ç½®ä¸€è‡´æ€§
    charset1=$(mysql -h$env1 -e "SHOW VARIABLES LIKE 'character_set_server'" -s -N | awk '{print $2}')
    charset2=$(mysql -h$env2 -e "SHOW VARIABLES LIKE 'character_set_server'" -s -N | awk '{print $2}')
    
    if [ "$charset1" != "$charset2" ]; then
        echo "âŒ å­—ç¬¦é›†ä¸ä¸€è‡´: $env1($charset1) vs $env2($charset2)"
    else
        echo "âœ… å­—ç¬¦é›†ä¸€è‡´: $charset1"
    fi
    
#    # 3. æ£€æŸ¥é‡è¦å‚æ•°ä¸€è‡´æ€§
    check_parameter "innodb_buffer_pool_size" $env1 $env2
    check_parameter "max_connections" $env1 $env2
    check_parameter "sql_mode" $env1 $env2
}

check_parameter() {
    local param=$1
    local env1=$2  
    local env2=$3
    
    val1=$(mysql -h$env1 -e "SHOW VARIABLES LIKE '$param'" -s -N | awk '{print $2}')
    val2=$(mysql -h$env2 -e "SHOW VARIABLES LIKE '$param'" -s -N | awk '{print $2}')
    
    if [ "$val1" != "$val2" ]; then
        echo "âŒ $param ä¸ä¸€è‡´: $env1($val1) vs $env2($val2)"
    else
        echo "âœ… $param ä¸€è‡´: $val1"
    fi
}

# æ‰§è¡Œæ£€æµ‹

check_mysql_consistency "test-mysql" "prod-mysql"
```

### 6.3 ç¯å¢ƒå˜é‡æ ‡å‡†åŒ–



**æ ‡å‡†ç¯å¢ƒå˜é‡é…ç½®**ï¼š
```bash
# /etc/profile.d/mysql-env.sh

# MySQLç¯å¢ƒå˜é‡æ ‡å‡†åŒ–é…ç½®


# åŸºç¡€ç¯å¢ƒå˜é‡

export MYSQL_HOME=/usr/local/mysql
export MYSQL_DATADIR=/var/lib/mysql
export MYSQL_LOGDIR=/var/log/mysql
export MYSQL_CONFDIR=/etc/mysql
export MYSQL_TMPDIR=/tmp/mysql

# è·¯å¾„é…ç½®

export PATH=$MYSQL_HOME/bin:$PATH
export LD_LIBRARY_PATH=$MYSQL_HOME/lib:$LD_LIBRARY_PATH

# è¿æ¥ç›¸å…³ç¯å¢ƒå˜é‡

export MYSQL_HOST=localhost
export MYSQL_PORT=3306
export MYSQL_SOCKET=/var/lib/mysql/mysql.sock

# æ ¹æ®ç¯å¢ƒè®¾ç½®ä¸åŒçš„æ•°æ®åº“è¿æ¥

case "$DEPLOYMENT_ENV" in
    "dev")
        export MYSQL_HOST=mysql-dev.internal.com
        export MYSQL_DATABASE=myapp_dev
        ;;
    "test")  
        export MYSQL_HOST=mysql-test.internal.com
        export MYSQL_DATABASE=myapp_test
        ;;
    "prod")
        export MYSQL_HOST=mysql-prod.internal.com
        export MYSQL_DATABASE=myapp_prod
        ;;
    *)
        echo "Unknown environment: $DEPLOYMENT_ENV"
        ;;
esac

# å®¢æˆ·ç«¯é…ç½®

export MYSQL_PWD_FILE=/etc/mysql/.mysql_passwords
export MYSQL_HISTFILE=/dev/null  # ä¸è®°å½•å‘½ä»¤å†å²
```

---

## 7. ğŸ”§ åŸºç¡€è®¾æ–½å³ä»£ç IaC



### 7.1 ä»€ä¹ˆæ˜¯åŸºç¡€è®¾æ–½å³ä»£ç 



**IaCçš„æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹å·¥é…ç½®æœåŠ¡å™¨ï¼Œæ‰‹å·¥å®‰è£…MySQLï¼Œæ‰‹å·¥ä¿®æ”¹é…ç½®
é—®é¢˜ï¼šé…ç½®ä¸ä¸€è‡´ï¼Œéš¾ä»¥å¤åˆ¶ï¼Œå®¹æ˜“å‡ºé”™ï¼Œæ— æ³•ç‰ˆæœ¬æ§åˆ¶

IaCæ–¹å¼ï¼šç”¨ä»£ç æè¿°åŸºç¡€è®¾æ–½ï¼Œè‡ªåŠ¨åŒ–åˆ›å»ºå’Œé…ç½®
ä¼˜åŠ¿ï¼šé…ç½®ä¸€è‡´ï¼Œå¯é‡å¤éƒ¨ç½²ï¼Œç‰ˆæœ¬æ§åˆ¶ï¼Œè‡ªåŠ¨åŒ–è¿ç»´
```

**IaCå·¥å…·é€‰æ‹©**ï¼š
```
Ansibleï¼šé…ç½®ç®¡ç†ï¼Œé€‚åˆMySQLå®‰è£…å’Œé…ç½®
Terraformï¼šåŸºç¡€è®¾æ–½åˆ›å»ºï¼Œé€‚åˆäº‘ç¯å¢ƒèµ„æºåˆ›å»º
Dockerï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼Œé€‚åˆå¼€å‘æµ‹è¯•ç¯å¢ƒ
Kubernetesï¼šå®¹å™¨ç¼–æ’ï¼Œé€‚åˆå¤§è§„æ¨¡å®¹å™¨åŒ–éƒ¨ç½²
```

### 7.2 Ansible MySQLéƒ¨ç½²æ¨¡æ¿



**Ansible Playbookç¤ºä¾‹**ï¼š
```yaml
---
- name: MySQLæ ‡å‡†åŒ–éƒ¨ç½²
  hosts: mysql_servers
  become: yes
  vars:
    mysql_version: "8.0.33"
    mysql_root_password: "{{ vault_mysql_root_password }}"
    mysql_datadir: "/var/lib/mysql"
    mysql_logdir: "/var/log/mysql"
    
  tasks:
    - name: å®‰è£…MySQLä»“åº“
      yum:
        name: "https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm"
        state: present
        
    - name: å®‰è£…MySQLæœåŠ¡å™¨
      yum:
        name: mysql-community-server
        state: present
        
    - name: åˆ›å»ºMySQLæ•°æ®ç›®å½•
      file:
        path: "{{ mysql_datadir }}"
        state: directory
        owner: mysql
        group: mysql
        mode: '0750'
        
    - name: åˆ›å»ºMySQLæ—¥å¿—ç›®å½•
      file:
        path: "{{ mysql_logdir }}"
        state: directory  
        owner: mysql
        group: mysql
        mode: '0750'
        
    - name: éƒ¨ç½²æ ‡å‡†é…ç½®æ–‡ä»¶
      template:
        src: templates/my.cnf.j2
        dest: /etc/mysql/my.cnf
        owner: root
        group: mysql
        mode: '0644'
      notify: restart mysql
        
    - name: å¯åŠ¨MySQLæœåŠ¡
      systemd:
        name: mysqld
        state: started
        enabled: yes
        
    - name: è·å–ä¸´æ—¶rootå¯†ç 
      shell: grep 'temporary password' /var/log/mysqld.log | awk '{print $NF}'
      register: mysql_temp_password
      
    - name: è®¾ç½®rootå¯†ç 
      mysql_user:
        login_password: "{{ mysql_temp_password.stdout }}"
        login_user: root
        name: root
        password: "{{ mysql_root_password }}"
        state: present
        
    - name: åˆ é™¤åŒ¿åç”¨æˆ·
      mysql_user:
        login_password: "{{ mysql_root_password }}"
        login_user: root
        name: ''
        host_all: yes
        state: absent
        
    - name: åˆ é™¤testæ•°æ®åº“
      mysql_db:
        login_password: "{{ mysql_root_password }}"
        login_user: root
        name: test
        state: absent
        
  handlers:
    - name: restart mysql
      systemd:
        name: mysqld
        state: restarted
```

**é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼ˆmy.cnf.j2ï¼‰**ï¼š
```ini
[mysqld]
# åŸºç¡€é…ç½®

port = {{ mysql_port | default(3306) }}
socket = {{ mysql_datadir }}/mysql.sock
datadir = {{ mysql_datadir }}
user = mysql
pid-file = /var/run/mysqld/mysqld.pid

# æ ¹æ®ç¯å¢ƒè°ƒæ•´é…ç½®

{% if environment == "prod" %}
innodb_buffer_pool_size = {{ ansible_memtotal_mb * 0.7 }}M
innodb_flush_log_at_trx_commit = 1
sync_binlog = 1
{% elif environment == "test" %}
innodb_buffer_pool_size = {{ ansible_memtotal_mb * 0.5 }}M
innodb_flush_log_at_trx_commit = 1
sync_binlog = 1
{% else %}
innodb_buffer_pool_size = {{ ansible_memtotal_mb * 0.3 }}M
innodb_flush_log_at_trx_commit = 2
sync_binlog = 0
{% endif %}

# å­—ç¬¦é›†é…ç½®

character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# æ—¥å¿—é…ç½®

log-error = {{ mysql_logdir }}/error.log
slow_query_log = ON
slow_query_log_file = {{ mysql_logdir }}/slow.log
long_query_time = 1

# äºŒè¿›åˆ¶æ—¥å¿—

log-bin = {{ mysql_logdir }}/binlog
binlog_format = ROW
expire_logs_days = {{ binlog_retention_days | default(7) }}

# å®‰å…¨é…ç½®

skip-name-resolve = ON
local-infile = OFF

[mysql]
default-character-set = utf8mb4
socket = {{ mysql_datadir }}/mysql.sock

[mysqldump]  
default-character-set = utf8mb4
single-transaction = ON
```

### 7.3 Dockerå®¹å™¨åŒ–éƒ¨ç½²



**æ ‡å‡†åŒ–Dockeré•œåƒ**ï¼š
```dockerfile
# Dockerfile - MySQLæ ‡å‡†åŒ–é•œåƒ

FROM mysql:8.0.33

# è®¾ç½®ç¯å¢ƒå˜é‡

ENV MYSQL_ROOT_PASSWORD_FILE=/run/secrets/mysql_root_password
ENV MYSQL_DATABASE=myapp
ENV MYSQL_USER=appuser
ENV MYSQL_PASSWORD_FILE=/run/secrets/mysql_password

# å¤åˆ¶é…ç½®æ–‡ä»¶

COPY config/my.cnf /etc/mysql/conf.d/
COPY scripts/init.sql /docker-entrypoint-initdb.d/

# å¤åˆ¶è¿ç»´è„šæœ¬  

COPY scripts/backup.sh /usr/local/bin/
COPY scripts/health-check.sh /usr/local/bin/

# è®¾ç½®æƒé™

RUN chmod +x /usr/local/bin/*.sh

# å¥åº·æ£€æŸ¥

HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
  CMD /usr/local/bin/health-check.sh

# æ•°æ®å·

VOLUME ["/var/lib/mysql"]

EXPOSE 3306
```

**Docker Composeç¼–æ’**ï¼š
```yaml
version: '3.8'

services:
  mysql-master:
    image: mysql:8.0.33-standard
    container_name: mysql-master
    hostname: mysql-master
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/mysql_root_password
      MYSQL_REPLICATION_USER: replicator
      MYSQL_REPLICATION_PASSWORD_FILE: /run/secrets/mysql_replication_password
    volumes:
      - mysql_master_data:/var/lib/mysql
      - mysql_master_logs:/var/log/mysql
      - ./config/master.cnf:/etc/mysql/conf.d/master.cnf
    secrets:
      - mysql_root_password
      - mysql_replication_password
    networks:
      - mysql_network
    restart: unless-stopped
    
  mysql-slave:  
    image: mysql:8.0.33-standard
    container_name: mysql-slave
    hostname: mysql-slave
    ports:
      - "3307:3306"  
    environment:
      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/mysql_root_password
    volumes:
      - mysql_slave_data:/var/lib/mysql
      - mysql_slave_logs:/var/log/mysql
      - ./config/slave.cnf:/etc/mysql/conf.d/slave.cnf
    secrets:
      - mysql_root_password
      - mysql_replication_password
    networks:
      - mysql_network
    depends_on:
      - mysql-master
    restart: unless-stopped

volumes:
  mysql_master_data:
  mysql_master_logs:
  mysql_slave_data:  
  mysql_slave_logs:

networks:
  mysql_network:
    driver: bridge

secrets:
  mysql_root_password:
    file: ./secrets/mysql_root_password.txt
  mysql_replication_password:
    file: ./secrets/mysql_replication_password.txt
```

---

## 8. ğŸ“‹ é…ç½®ç®¡ç†ä¸ç‰ˆæœ¬æ§åˆ¶



### 8.1 é…ç½®ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥



**Gité…ç½®ç®¡ç†ç»“æ„**ï¼š
```
mysql-configs/
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ my.cnf
â”‚   â”‚   â”œâ”€â”€ init.sql
â”‚   â”‚   â””â”€â”€ users.sql
â”‚   â”œâ”€â”€ test/
â”‚   â”‚   â”œâ”€â”€ my.cnf
â”‚   â”‚   â”œâ”€â”€ init.sql
â”‚   â”‚   â””â”€â”€ users.sql
â”‚   â””â”€â”€ prod/
â”‚       â”œâ”€â”€ my.cnf
â”‚       â”œâ”€â”€ init.sql
â”‚       â””â”€â”€ users.sql
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ my.cnf.j2
â”‚   â””â”€â”€ init.sql.j2
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â”œâ”€â”€ backup.sh
â”‚   â””â”€â”€ health-check.sh
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ configuration-guide.md
â”‚   â”œâ”€â”€ deployment-guide.md
â”‚   â””â”€â”€ troubleshooting.md
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â””â”€â”€ CHANGELOG.md
```

**é…ç½®å˜æ›´æµç¨‹**ï¼š
```
é…ç½®å˜æ›´Gitå·¥ä½œæµï¼š
1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: git checkout -b config/update-buffer-pool
2. ä¿®æ”¹é…ç½®æ–‡ä»¶: ç¼–è¾‘å¯¹åº”ç¯å¢ƒçš„my.cnf
3. æµ‹è¯•éªŒè¯: åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®æ­£ç¡®æ€§
4. æäº¤å˜æ›´: git commit -m "Update innodb_buffer_pool_size for prod"
5. ä»£ç å®¡æŸ¥: åˆ›å»ºPull Requestï¼Œå›¢é˜Ÿå®¡æŸ¥
6. åˆå¹¶ä¸»åˆ†æ”¯: å®¡æŸ¥é€šè¿‡ååˆå¹¶åˆ°mainåˆ†æ”¯
7. éƒ¨ç½²ç”Ÿäº§: ä½¿ç”¨CI/CDè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
8. å˜æ›´è®°å½•: æ›´æ–°CHANGELOG.mdæ–‡æ¡£
```

### 8.2 ç¯å¢ƒå˜æ›´å®¡æ‰¹æµç¨‹



**å˜æ›´å®¡æ‰¹å·¥ä½œæµ**ï¼š
```
å˜æ›´ç”³è¯· â†’ é£é™©è¯„ä¼° â†’ æŠ€æœ¯å®¡æŸ¥ â†’ ä¸šåŠ¡å®¡æ‰¹ â†’ æ‰§è¡Œéƒ¨ç½² â†’ ç»“æœéªŒè¯

è¯¦ç»†æµç¨‹ï¼š
1. å˜æ›´ç”³è¯·é˜¶æ®µ
   â”œâ”€ å¡«å†™å˜æ›´ç”³è¯·å•
   â”œâ”€ æè¿°å˜æ›´å†…å®¹å’ŒåŸå› 
   â”œâ”€ è¯„ä¼°å˜æ›´å½±å“èŒƒå›´
   â””â”€ åˆ¶å®šå›æ»šè®¡åˆ’

2. é£é™©è¯„ä¼°é˜¶æ®µ
   â”œâ”€ æŠ€æœ¯é£é™©è¯„ä¼°
   â”œâ”€ ä¸šåŠ¡å½±å“è¯„ä¼°  
   â”œâ”€ å®‰å…¨é£é™©è¯„ä¼°
   â””â”€ åˆ¶å®šé£é™©æ§åˆ¶æªæ–½

3. æŠ€æœ¯å®¡æŸ¥é˜¶æ®µ
   â”œâ”€ DBAæŠ€æœ¯å®¡æŸ¥
   â”œâ”€ ç³»ç»Ÿæ¶æ„å¸ˆå®¡æŸ¥
   â”œâ”€ å®‰å…¨å›¢é˜Ÿå®¡æŸ¥
   â””â”€ è¿ç»´å›¢é˜Ÿå®¡æŸ¥

4. ä¸šåŠ¡å®¡æ‰¹é˜¶æ®µ
   â”œâ”€ ä¸šåŠ¡è´Ÿè´£äººå®¡æ‰¹
   â”œâ”€ æŠ€æœ¯è´Ÿè´£äººå®¡æ‰¹
   â”œâ”€ è¿ç»´è´Ÿè´£äººå®¡æ‰¹
   â””â”€ å˜æ›´å§”å‘˜ä¼šå®¡æ‰¹ï¼ˆé«˜é£é™©å˜æ›´ï¼‰

5. æ‰§è¡Œéƒ¨ç½²é˜¶æ®µ
   â”œâ”€ æŒ‰è®¡åˆ’æ‰§è¡Œå˜æ›´
   â”œâ”€ å®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€
   â”œâ”€ è®°å½•æ‰§è¡Œè¿‡ç¨‹
   â””â”€ é‡åˆ°é—®é¢˜ç«‹å³å›æ»š

6. ç»“æœéªŒè¯é˜¶æ®µ
   â”œâ”€ åŠŸèƒ½éªŒè¯æµ‹è¯•
   â”œâ”€ æ€§èƒ½éªŒè¯æµ‹è¯•
   â”œâ”€ ä¸šåŠ¡éªŒè¯æµ‹è¯•
   â””â”€ å˜æ›´æ€»ç»“æŠ¥å‘Š
```

**å˜æ›´ç”³è¯·æ¨¡æ¿**ï¼š
```markdown
# MySQLé…ç½®å˜æ›´ç”³è¯·


# åŸºæœ¬ä¿¡æ¯


- **ç”³è¯·äºº**: å¼ ä¸‰
- **ç”³è¯·æ—¶é—´**: 2025-09-01 16:00:00
- **å˜æ›´ç±»å‹**: é…ç½®å‚æ•°è°ƒä¼˜
- **ç¯å¢ƒ**: ç”Ÿäº§ç¯å¢ƒ
- **ç´§æ€¥ç¨‹åº¦**: ğŸŸ¡ ä¸­ç­‰

# å˜æ›´å†…å®¹


## å˜æ›´å‰é…ç½®


```ini
innodb_buffer_pool_size = 4G
max_connections = 500
```

## å˜æ›´åé…ç½®  


```ini
innodb_buffer_pool_size = 8G
max_connections = 1000
```

# å˜æ›´åŸå› 


- ä¸šåŠ¡å¢é•¿ï¼Œè¿æ¥æ•°ä¸è¶³å¯¼è‡´è¿æ¥ç­‰å¾…
- å†…å­˜åˆ©ç”¨ç‡ä½ï¼Œå¯ä»¥å¢å¤§ç¼“å†²æ± æå‡æ€§èƒ½

# å½±å“è¯„ä¼°


- **å½±å“èŒƒå›´**: ç”µå•†è®¢å•ç³»ç»Ÿä¸»åº“
- **ä¸šåŠ¡å½±å“**: éœ€è¦é‡å¯MySQLæœåŠ¡ï¼Œé¢„è®¡åœæœº5åˆ†é’Ÿ
- **æŠ€æœ¯é£é™©**: ä½ï¼Œä»…å‚æ•°è°ƒæ•´ï¼Œå¯å¿«é€Ÿå›æ»š
- **ç”¨æˆ·å½±å“**: è®¢å•æœåŠ¡çŸ­æš‚ä¸å¯ç”¨

# å®æ–½è®¡åˆ’


- **è®¡åˆ’æ—¶é—´**: 2025-09-01 23:00-23:30
- **æ‰§è¡Œäººå‘˜**: DBAå›¢é˜Ÿï¼ˆå¼ ä¸‰ã€æå››ï¼‰
- **å®æ–½æ­¥éª¤**:
  1. 23:00 åœæ­¢åº”ç”¨æµé‡
  2. 23:05 ä¿®æ”¹é…ç½®æ–‡ä»¶
  3. 23:10 é‡å¯MySQLæœåŠ¡  
  4. 23:15 éªŒè¯æœåŠ¡çŠ¶æ€
  5. 23:20 æ¢å¤åº”ç”¨æµé‡
  6. 23:30 ç›‘æ§ç¡®è®¤æ­£å¸¸

# å›æ»šè®¡åˆ’


- **å›æ»šè§¦å‘æ¡ä»¶**: æœåŠ¡å¯åŠ¨å¤±è´¥ã€æ€§èƒ½ä¸¥é‡ä¸‹é™
- **å›æ»šæ­¥éª¤**: æ¢å¤åŸé…ç½®æ–‡ä»¶ï¼Œé‡å¯æœåŠ¡
- **å›æ»šæ—¶é—´**: 5åˆ†é’Ÿå†…

# å®¡æ‰¹è®°å½•


- [ ] DBAå®¡æŸ¥ (å¼ ä¸‰): âœ… é€šè¿‡
- [ ] æ¶æ„å¸ˆå®¡æŸ¥ (ç‹äº”): â³ å¾…å®¡æ‰¹  
- [ ] ä¸šåŠ¡è´Ÿè´£äºº (èµµå…­): â³ å¾…å®¡æ‰¹
- [ ] è¿ç»´è´Ÿè´£äºº (é’±ä¸ƒ): â³ å¾…å®¡æ‰¹
```

### 8.3 é…ç½®æ¼‚ç§»æ£€æµ‹



**ä»€ä¹ˆæ˜¯é…ç½®æ¼‚ç§»**ï¼š
```
é…ç½®æ¼‚ç§»ï¼šå®é™…è¿è¡Œç¯å¢ƒçš„é…ç½®ä¸æ ‡å‡†é…ç½®æ¨¡æ¿ä¸ä¸€è‡´

äº§ç”ŸåŸå› ï¼š
â”œâ”€ ç´§æ€¥ä¿®å¤æ—¶ä¸´æ—¶ä¿®æ”¹é…ç½®
â”œâ”€ æ‰‹å·¥æ“ä½œå¯¼è‡´çš„é…ç½®åå·®
â”œâ”€ è‡ªåŠ¨åŒ–å·¥å…·æ‰§è¡Œå¤±è´¥
â”œâ”€ æ¶æ„æˆ–æ„å¤–çš„é…ç½®ä¿®æ”¹
â””â”€ é…ç½®æ–‡ä»¶æŸåæˆ–ä¸¢å¤±

å±å®³ï¼š
â”œâ”€ ç¯å¢ƒä¸€è‡´æ€§è¢«ç ´å
â”œâ”€ é—®é¢˜éš¾ä»¥å®šä½å’Œå¤ç°  
â”œâ”€ å®‰å…¨é£é™©å¢åŠ 
â”œâ”€ è¿ç»´å¤æ‚åº¦å¢åŠ 
â””â”€ å¯èƒ½å¯¼è‡´æœåŠ¡æ•…éšœ
```

**é…ç½®æ¼‚ç§»æ£€æµ‹è„šæœ¬**ï¼š
```bash
#!/bin/bash

# MySQLé…ç½®æ¼‚ç§»æ£€æµ‹è„šæœ¬


CONFIG_DRIFT_CHECK() {
    local host=$1
    local standard_config="/opt/mysql-configs/prod/my.cnf"
    local current_config="/tmp/current_my.cnf"
    
    echo "æ£€æµ‹ $host çš„é…ç½®æ¼‚ç§»..."
    
#    # 1. è·å–å½“å‰è¿è¡Œé…ç½®
    mysql -h$host -e "SELECT $$global.innodb_buffer_pool_size" -s -N > /tmp/current_buffer_pool.txt
    mysql -h$host -e "SELECT $$global.max_connections" -s -N > /tmp/current_max_conn.txt
    mysql -h$host -e "SELECT $$global.sql_mode" -s -N > /tmp/current_sql_mode.txt
    
#    # 2. ä»æ ‡å‡†é…ç½®è·å–é¢„æœŸå€¼
    expected_buffer_pool=$(grep "innodb_buffer_pool_size" $standard_config | cut -d'=' -f2 | tr -d ' ')
    expected_max_conn=$(grep "max_connections" $standard_config | cut -d'=' -f2 | tr -d ' ')
    expected_sql_mode=$(grep "sql_mode" $standard_config | cut -d'=' -f2 | tr -d ' ')
    
#    # 3. å¯¹æ¯”æ£€æµ‹
    current_buffer_pool=$(cat /tmp/current_buffer_pool.txt)
    current_max_conn=$(cat /tmp/current_max_conn.txt)  
    current_sql_mode=$(cat /tmp/current_sql_mode.txt)
    
#    # 4. æŠ¥å‘Šæ¼‚ç§»ç»“æœ
    drift_count=0
    
    if [ "$current_buffer_pool" != "$expected_buffer_pool" ]; then
        echo "âŒ é…ç½®æ¼‚ç§»: innodb_buffer_pool_size"
        echo "   é¢„æœŸ: $expected_buffer_pool"
        echo "   å®é™…: $current_buffer_pool"
        ((drift_count++))
    fi
    
    if [ "$current_max_conn" != "$expected_max_conn" ]; then
        echo "âŒ é…ç½®æ¼‚ç§»: max_connections"  
        echo "   é¢„æœŸ: $expected_max_conn"
        echo "   å®é™…: $current_max_conn"
        ((drift_count++))
    fi
    
    if [ "$current_sql_mode" != "$expected_sql_mode" ]; then
        echo "âŒ é…ç½®æ¼‚ç§»: sql_mode"
        echo "   é¢„æœŸ: $expected_sql_mode"
        echo "   å®é™…: $current_sql_mode"  
        ((drift_count++))
    fi
    
    if [ $drift_count -eq 0 ]; then
        echo "âœ… é…ç½®æ£€æŸ¥é€šè¿‡ï¼Œæ— é…ç½®æ¼‚ç§»"
    else
        echo "âš ï¸  å‘ç° $drift_count é¡¹é…ç½®æ¼‚ç§»"
        
#        # å‘é€å‘Šè­¦
        send_alert "$host" "$drift_count"
        
#        # ç”Ÿæˆä¿®å¤è„šæœ¬
        generate_fix_script "$host"
    fi
    
#    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f /tmp/current_*.txt
}

send_alert() {
    local host=$1
    local drift_count=$2
    
#    # å‘é€é‚®ä»¶å‘Šè­¦
    echo "MySQLå®ä¾‹ $host å‘ç° $drift_count é¡¹é…ç½®æ¼‚ç§»ï¼Œè¯·åŠæ—¶å¤„ç†" | \
    mail -s "MySQLé…ç½®æ¼‚ç§»å‘Šè­¦" ops-team@company.com
    
#    # å‘é€é’‰é’‰å‘Šè­¦
    curl -X POST "https://oapi.dingtalk.com/robot/send?access_token=xxx" \
    -H "Content-Type: application/json" \
    -d "{
        \"msgtype\": \"text\",
        \"text\": {
            \"content\": \"MySQLé…ç½®æ¼‚ç§»å‘Šè­¦\\nå®ä¾‹: $host\\næ¼‚ç§»é¡¹: $drift_count\\nè¯·DBAåŠæ—¶å¤„ç†\"
        }
    }"
}

generate_fix_script() {
    local host=$1
    
    cat > "/tmp/fix_drift_$host.sql" << EOF
-- MySQLé…ç½®æ¼‚ç§»ä¿®å¤è„šæœ¬
-- å®ä¾‹: $host
-- ç”Ÿæˆæ—¶é—´: $(date)

SET GLOBAL innodb_buffer_pool_size = $expected_buffer_pool;
SET GLOBAL max_connections = $expected_max_conn;
SET GLOBAL sql_mode = '$expected_sql_mode';

-- æ³¨æ„ï¼šéƒ¨åˆ†å‚æ•°éœ€è¦é‡å¯MySQLæ‰èƒ½ç”Ÿæ•ˆ
-- å»ºè®®åœ¨ç»´æŠ¤çª—å£æœŸé—´æ‰§è¡Œ
EOF
    
    echo "ä¿®å¤è„šæœ¬å·²ç”Ÿæˆ: /tmp/fix_drift_$host.sql"
}

# æ‰§è¡Œæ£€æµ‹

CONFIG_DRIFT_CHECK "mysql-prod-01"
CONFIG_DRIFT_CHECK "mysql-prod-02"
```

---

## 9. ğŸ“Š ç›‘æ§ä¸åˆè§„æ€§æ£€æŸ¥



### 9.1 ç›‘æ§æŒ‡æ ‡æ ‡å‡†åŒ–



**æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ä½“ç³»**ï¼š
```yaml
mysql_monitoring_metrics:
  
#  # æœåŠ¡å¯ç”¨æ€§æŒ‡æ ‡
  availability:
    - metric: mysql_up
      description: MySQLæœåŠ¡è¿è¡ŒçŠ¶æ€
      threshold: "== 0"
      severity: critical
      
    - metric: mysql_slave_lag_seconds  
      description: ä¸»ä»å»¶è¿Ÿæ—¶é—´
      threshold: "> 10"
      severity: warning
      
    - metric: mysql_connections_available
      description: å¯ç”¨è¿æ¥æ•°ç™¾åˆ†æ¯”
      threshold: "< 20"
      severity: critical

#  # æ€§èƒ½æŒ‡æ ‡
  performance:
    - metric: mysql_global_status_queries_per_second
      description: æ¯ç§’æŸ¥è¯¢æ•°
      threshold: "> 1000"
      severity: info
      
    - metric: mysql_global_status_slow_queries_per_second
      description: æ¯ç§’æ…¢æŸ¥è¯¢æ•°
      threshold: "> 10"  
      severity: warning
      
    - metric: mysql_global_status_threads_running
      description: æ´»è·ƒçº¿ç¨‹æ•°
      threshold: "> 100"
      severity: warning

#  # èµ„æºä½¿ç”¨æŒ‡æ ‡
  resources:
    - metric: mysql_global_status_innodb_buffer_pool_utilization
      description: InnoDBç¼“å†²æ± ä½¿ç”¨ç‡
      threshold: "> 90"
      severity: warning
      
    - metric: mysql_global_status_innodb_log_waits
      description: InnoDBæ—¥å¿—ç­‰å¾…æ¬¡æ•°
      threshold: "> 0"
      severity: warning
      
    - metric: mysql_info_schema_disk_usage_bytes
      description: ç£ç›˜ä½¿ç”¨é‡
      threshold: "> 80%"
      severity: critical

#  # é”™è¯¯å’Œå¼‚å¸¸æŒ‡æ ‡
  errors:
    - metric: mysql_global_status_aborted_connects_per_second
      description: æ¯ç§’ä¸­æ–­è¿æ¥æ•°
      threshold: "> 5"
      severity: warning
      
    - metric: mysql_global_status_table_locks_waited_per_second
      description: æ¯ç§’è¡¨é”ç­‰å¾…æ¬¡æ•°
      threshold: "> 1"
      severity: warning
```

**Prometheusç›‘æ§é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# prometheus.yml MySQLç›‘æ§é…ç½®

global:
  scrape_interval: 15s
  
scrape_configs:
  - job_name: 'mysql-exporter'
    static_configs:
      - targets: 
        - 'mysql-prod-01:9104'
        - 'mysql-prod-02:9104'
        - 'mysql-test-01:9104'
    labels:
      environment: 'production'
      
  - job_name: 'mysql-exporter-test'  
    static_configs:
      - targets:
        - 'mysql-dev-01:9104'
    labels:
      environment: 'development'

rule_files:
  - "mysql_alerts.yml"
  
alerting:
  alertmanagers:
    - static_configs:
      - targets:
        - 'alertmanager:9093'
```

**å‘Šè­¦è§„åˆ™é…ç½®**ï¼š
```yaml
# mysql_alerts.yml

groups:
  - name: mysql.rules
    rules:
      - alert: MySQLDown
        expr: mysql_up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "MySQL instance {{ $labels.instance }} is down"
          description: "MySQL instance {{ $labels.instance }} has been down for more than 1 minute."
          
      - alert: MySQLSlowQueries
        expr: rate(mysql_global_status_slow_queries[5m]) > 0.1
        for: 5m
        labels:
          severity: warning  
        annotations:
          summary: "High slow queries rate on {{ $labels.instance }}"
          description: "MySQL instance {{ $labels.instance }} has slow queries rate of {{ $value }} per second."
          
      - alert: MySQLConnectionsHigh
        expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High MySQL connections on {{ $labels.instance }}"
          description: "MySQL instance {{ $labels.instance }} connections usage is above 80%."
```

### 9.2 ç¯å¢ƒåˆè§„æ€§æ£€æŸ¥



**åˆè§„æ€§æ£€æŸ¥æ¸…å•**ï¼š
```markdown
# MySQLç¯å¢ƒåˆè§„æ€§æ£€æŸ¥æ¸…å•


# å®‰å…¨åˆè§„æ£€æŸ¥


- [ ] é»˜è®¤è´¦æˆ·å·²åˆ é™¤æˆ–ç¦ç”¨
- [ ] ç®¡ç†å‘˜è´¦æˆ·å¯†ç ç¬¦åˆå¤æ‚åº¦è¦æ±‚
- [ ] ä¸šåŠ¡è´¦æˆ·æƒé™ç¬¦åˆæœ€å°æƒé™åŸåˆ™
- [ ] SSL/TLSåŠ å¯†å·²å¯ç”¨ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] å®¡è®¡æ—¥å¿—å·²å¯ç”¨å¹¶æ­£å¸¸è®°å½•
- [ ] é˜²ç«å¢™è§„åˆ™å·²æ­£ç¡®é…ç½®
- [ ] ä¸å®‰å…¨åŠŸèƒ½å·²ç¦ç”¨ï¼ˆlocal-infileç­‰ï¼‰

# é…ç½®åˆè§„æ£€æŸ¥  


- [ ] MySQLç‰ˆæœ¬ç¬¦åˆæ ‡å‡†è¦æ±‚
- [ ] ç«¯å£é…ç½®ç¬¦åˆæ ‡å‡†ï¼ˆ3306ï¼‰
- [ ] å­—ç¬¦é›†é…ç½®ç»Ÿä¸€ï¼ˆutf8mb4ï¼‰
- [ ] æ—¶åŒºè®¾ç½®æ­£ç¡®
- [ ] äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼æ­£ç¡®ï¼ˆROWï¼‰
- [ ] æ…¢æŸ¥è¯¢æ—¥å¿—å·²å¯ç”¨
- [ ] é”™è¯¯æ—¥å¿—è·¯å¾„æ­£ç¡®

# æ€§èƒ½é…ç½®åˆè§„æ£€æŸ¥


- [ ] InnoDBç¼“å†²æ± å¤§å°åˆç†é…ç½®
- [ ] è¿æ¥æ•°é™åˆ¶åˆç†è®¾ç½®
- [ ] è¶…æ—¶å‚æ•°åˆç†é…ç½®
- [ ] æ’åºç¼“å†²åŒºå¤§å°åˆç†
- [ ] ä¸´æ—¶è¡¨é…ç½®åˆç†

# é«˜å¯ç”¨é…ç½®åˆè§„æ£€æŸ¥


- [ ] ä¸»ä»å¤åˆ¶é…ç½®æ­£ç¡®ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] åŠåŒæ­¥å¤åˆ¶å·²å¯ç”¨ï¼ˆå¦‚é€‚ç”¨ï¼‰  
- [ ] GTIDæ¨¡å¼å·²å¯ç”¨ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] æ•…éšœè½¬ç§»å·¥å…·å·²éƒ¨ç½²
- [ ] å¤‡ä»½ç­–ç•¥å·²å®æ–½

# ç›‘æ§åˆè§„æ£€æŸ¥


- [ ] ç›‘æ§agentå·²å®‰è£…å¹¶è¿è¡Œ
- [ ] å…³é”®æŒ‡æ ‡ç›‘æ§å·²é…ç½®
- [ ] å‘Šè­¦è§„åˆ™å·²è®¾ç½®
- [ ] å‘Šè­¦é€šçŸ¥æ¸ é“å·²é…ç½®
- [ ] ç›‘æ§ä»ªè¡¨ç›˜å·²åˆ›å»º

# æ–‡æ¡£åˆè§„æ£€æŸ¥


- [ ] éƒ¨ç½²æ–‡æ¡£å·²æ›´æ–°
- [ ] è¿ç»´æ‰‹å†Œå·²å®Œå–„
- [ ] åº”æ€¥å“åº”æµç¨‹å·²åˆ¶å®š
- [ ] è”ç³»äººä¿¡æ¯å·²æ›´æ–°
- [ ] å˜æ›´è®°å½•å·²ç»´æŠ¤
```

**è‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash

# MySQLç¯å¢ƒåˆè§„æ€§è‡ªåŠ¨æ£€æŸ¥è„šæœ¬


MYSQL_COMPLIANCE_CHECK() {
    local host=$1
    local port=${2:-3306}
    local check_result="/tmp/mysql_compliance_$host.txt"
    
    echo "MySQLç¯å¢ƒåˆè§„æ€§æ£€æŸ¥æŠ¥å‘Š - $host:$port" > $check_result
    echo "æ£€æŸ¥æ—¶é—´: $(date)" >> $check_result
    echo "=================================" >> $check_result
    
#    # 1. å®‰å…¨åˆè§„æ£€æŸ¥
    echo "## å®‰å…¨åˆè§„æ£€æŸ¥" >> $check_result
    
#    # æ£€æŸ¥åŒ¿åç”¨æˆ·
    anonymous_users=$(mysql -h$host -P$port -e "SELECT COUNT(*) FROM mysql.user WHERE User=''" -s -N)
    if [ "$anonymous_users" -gt 0 ]; then
        echo "âŒ å‘ç° $anonymous_users ä¸ªåŒ¿åç”¨æˆ·è´¦æˆ·" >> $check_result
    else
        echo "âœ… æ— åŒ¿åç”¨æˆ·è´¦æˆ·" >> $check_result
    fi
    
#    # æ£€æŸ¥rootè¿œç¨‹ç™»å½•
    root_remote=$(mysql -h$host -P$port -e "SELECT COUNT(*) FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost','127.0.0.1','::1')" -s -N)
    if [ "$root_remote" -gt 0 ]; then
        echo "âŒ rootç”¨æˆ·å…è®¸è¿œç¨‹ç™»å½•" >> $check_result
    else
        echo "âœ… rootç”¨æˆ·ä»…å…è®¸æœ¬åœ°ç™»å½•" >> $check_result
    fi
    
#    # æ£€æŸ¥SSLé…ç½®
    ssl_enabled=$(mysql -h$host -P$port -e "SHOW VARIABLES LIKE 'have_ssl'" -s -N | awk '{print $2}')
    if [ "$ssl_enabled" = "YES" ]; then
        echo "âœ… SSLå·²å¯ç”¨" >> $check_result
    else
        echo "âš ï¸  SSLæœªå¯ç”¨" >> $check_result
    fi
    
#    # 2. é…ç½®åˆè§„æ£€æŸ¥
    echo -e "\n## é…ç½®åˆè§„æ£€æŸ¥" >> $check_result
    
#    # æ£€æŸ¥ç‰ˆæœ¬
    version=$(mysql -h$host -P$port -e "SELECT VERSION()" -s -N)
    if [[ $version == 8.0* ]]; then
        echo "âœ… MySQLç‰ˆæœ¬ç¬¦åˆæ ‡å‡†: $version" >> $check_result
    else
        echo "âš ï¸  MySQLç‰ˆæœ¬å¯èƒ½éœ€è¦å‡çº§: $version" >> $check_result
    fi
    
#    # æ£€æŸ¥å­—ç¬¦é›†
    charset=$(mysql -h$host -P$port -e "SHOW VARIABLES LIKE 'character_set_server'" -s -N | awk '{print $2}')
    if [ "$charset" = "utf8mb4" ]; then
        echo "âœ… å­—ç¬¦é›†é…ç½®æ­£ç¡®: $charset" >> $check_result
    else
        echo "âŒ å­—ç¬¦é›†é…ç½®ä¸æ ‡å‡†: $charset (åº”ä¸ºutf8mb4)" >> $check_result
    fi
    
#    # æ£€æŸ¥äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼
    binlog_format=$(mysql -h$host -P$port -e "SHOW VARIABLES LIKE 'binlog_format'" -s -N | awk '{print $2}')
    if [ "$binlog_format" = "ROW" ]; then
        echo "âœ… äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼æ­£ç¡®: $binlog_format" >> $check_result
    else
        echo "âŒ äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ä¸æ ‡å‡†: $binlog_format (åº”ä¸ºROW)" >> $check_result
    fi
    
#    # æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—
    slow_query_log=$(mysql -h$host -P$port -e "SHOW VARIABLES LIKE 'slow_query_log'" -s -N | awk '{print $2}')
    if [ "$slow_query_log" = "ON" ]; then
        echo "âœ… æ…¢æŸ¥è¯¢æ—¥å¿—å·²å¯ç”¨" >> $check_result
    else
        echo "âŒ æ…¢æŸ¥è¯¢æ—¥å¿—æœªå¯ç”¨" >> $check_result
    fi
    
#    # 3. æ€§èƒ½é…ç½®æ£€æŸ¥
    echo -e "\n## æ€§èƒ½é…ç½®æ£€æŸ¥" >> $check_result
    
#    # æ£€æŸ¥ç¼“å†²æ± å¤§å°
    buffer_pool_size=$(mysql -h$host -P$port -e "SHOW VARIABLES LIKE 'innodb_buffer_pool_size'" -s -N | awk '{print $2}')
    buffer_pool_gb=$((buffer_pool_size / 1024 / 1024 / 1024))
    if [ $buffer_pool_gb -ge 1 ]; then
        echo "âœ… InnoDBç¼“å†²æ± å¤§å°: ${buffer_pool_gb}GB" >> $check_result
    else
        echo "âš ï¸  InnoDBç¼“å†²æ± è¾ƒå°: ${buffer_pool_gb}GB" >> $check_result
    fi
    
#    # æ£€æŸ¥æœ€å¤§è¿æ¥æ•°
    max_connections=$(mysql -h$host -P$port -e "SHOW VARIABLES LIKE 'max_connections'" -s -N | awk '{print $2}')
    if [ "$max_connections" -ge 500 ]; then
        echo "âœ… æœ€å¤§è¿æ¥æ•°é…ç½®åˆç†: $max_connections" >> $check_result
    else
        echo "âš ï¸  æœ€å¤§è¿æ¥æ•°è¾ƒä½: $max_connections" >> $check_result
    fi
    
#    # 4. é«˜å¯ç”¨é…ç½®æ£€æŸ¥
    echo -e "\n## é«˜å¯ç”¨é…ç½®æ£€æŸ¥" >> $check_result
    
#    # æ£€æŸ¥ä¸»ä»å¤åˆ¶çŠ¶æ€
    slave_status=$(mysql -h$host -P$port -e "SHOW SLAVE STATUS\G" 2>/dev/null)
    if [ -n "$slave_status" ]; then
        io_running=$(echo "$slave_status" | grep "Slave_IO_Running" | awk '{print $2}')
        sql_running=$(echo "$slave_status" | grep "Slave_SQL_Running" | awk '{print $2}')
        if [ "$io_running" = "Yes" ] && [ "$sql_running" = "Yes" ]; then
            echo "âœ… ä»åº“å¤åˆ¶çŠ¶æ€æ­£å¸¸" >> $check_result
        else
            echo "âŒ ä»åº“å¤åˆ¶çŠ¶æ€å¼‚å¸¸: IO_Running=$io_running, SQL_Running=$sql_running" >> $check_result
        fi
    else
        master_status=$(mysql -h$host -P$port -e "SHOW MASTER STATUS\G" 2>/dev/null)
        if [ -n "$master_status" ]; then
            echo "âœ… ä¸»åº“äºŒè¿›åˆ¶æ—¥å¿—æ­£å¸¸" >> $check_result
        else
            echo "âš ï¸  éä¸»ä»å¤åˆ¶ç¯å¢ƒ" >> $check_result
        fi
    fi
    
#    # 5. ç›‘æ§çŠ¶æ€æ£€æŸ¥
    echo -e "\n## ç›‘æ§çŠ¶æ€æ£€æŸ¥" >> $check_result
    
#    # æ£€æŸ¥Performance Schema
    perf_schema=$(mysql -h$host -P$port -e "SHOW VARIABLES LIKE 'performance_schema'" -s -N | awk '{print $2}')
    if [ "$perf_schema" = "ON" ]; then
        echo "âœ… Performance Schemaå·²å¯ç”¨" >> $check_result
    else
        echo "âš ï¸  Performance Schemaæœªå¯ç”¨" >> $check_result
    fi
    
#    # æ£€æŸ¥ç›‘æ§ç”¨æˆ·
    monitor_user=$(mysql -h$host -P$port -e "SELECT COUNT(*) FROM mysql.user WHERE User LIKE '%monitor%'" -s -N)
    if [ "$monitor_user" -gt 0 ]; then
        echo "âœ… å‘ç°ç›‘æ§ç”¨æˆ·è´¦æˆ·" >> $check_result
    else
        echo "âš ï¸  æœªå‘ç°ç›‘æ§ç”¨æˆ·è´¦æˆ·" >> $check_result
    fi
    
#    # 6. ç»Ÿè®¡æ£€æŸ¥ç»“æœ
    echo -e "\n## æ£€æŸ¥ç»“æœç»Ÿè®¡" >> $check_result
    total_checks=$(grep -c "âœ…\|âŒ\|âš ï¸" $check_result)
    passed_checks=$(grep -c "âœ…" $check_result)
    failed_checks=$(grep -c "âŒ" $check_result)
    warning_checks=$(grep -c "âš ï¸" $check_result)
    
    echo "æ€»æ£€æŸ¥é¡¹: $total_checks" >> $check_result
    echo "é€šè¿‡æ£€æŸ¥: $passed_checks" >> $check_result
    echo "å¤±è´¥æ£€æŸ¥: $failed_checks" >> $check_result
    echo "è­¦å‘Šæ£€æŸ¥: $warning_checks" >> $check_result
    
    compliance_rate=$((passed_checks * 100 / total_checks))
    echo "åˆè§„ç‡: ${compliance_rate}%" >> $check_result
    
    if [ $compliance_rate -ge 90 ]; then
        echo "ğŸ‰ åˆè§„æ€§æ£€æŸ¥: ä¼˜ç§€" >> $check_result
    elif [ $compliance_rate -ge 75 ]; then
        echo "ğŸ‘ åˆè§„æ€§æ£€æŸ¥: è‰¯å¥½" >> $check_result
    elif [ $compliance_rate -ge 60 ]; then
        echo "âš ï¸  åˆè§„æ€§æ£€æŸ¥: ä¸€èˆ¬ï¼Œéœ€è¦æ”¹è¿›" >> $check_result
    else
        echo "âŒ åˆè§„æ€§æ£€æŸ¥: è¾ƒå·®ï¼Œæ€¥éœ€æ”¹è¿›" >> $check_result
    fi
    
#    # æ˜¾ç¤ºæ£€æŸ¥ç»“æœ
    cat $check_result
    
#    # å‘é€é‚®ä»¶æŠ¥å‘Š
    if [ $failed_checks -gt 0 ]; then
        send_compliance_alert "$host" "$check_result"
    fi
}

send_compliance_alert() {
    local host=$1
    local report_file=$2
    
    echo "MySQLå®ä¾‹ $host åˆè§„æ€§æ£€æŸ¥å‘ç°é—®é¢˜ï¼Œè¯¦ç»†æŠ¥å‘Šè¯·æŸ¥çœ‹é™„ä»¶" | \
    mail -s "MySQLåˆè§„æ€§æ£€æŸ¥å‘Šè­¦ - $host" -A "$report_file" dba-team@company.com
}

# æ‰¹é‡æ£€æŸ¥å¤šä¸ªå®ä¾‹

check_all_instances() {
    echo "å¼€å§‹æ‰¹é‡MySQLåˆè§„æ€§æ£€æŸ¥..."
    
#    # ç”Ÿäº§ç¯å¢ƒå®ä¾‹
    MYSQL_COMPLIANCE_CHECK "mysql-prod-01" 3306
    MYSQL_COMPLIANCE_CHECK "mysql-prod-02" 3306
    
#    # æµ‹è¯•ç¯å¢ƒå®ä¾‹
    MYSQL_COMPLIANCE_CHECK "mysql-test-01" 3306
    
#    # å¼€å‘ç¯å¢ƒå®ä¾‹
    MYSQL_COMPLIANCE_CHECK "mysql-dev-01" 3306
    
    echo "æ‰€æœ‰å®ä¾‹åˆè§„æ€§æ£€æŸ¥å®Œæˆ"
}

# æ‰§è¡Œæ£€æŸ¥

check_all_instances
```

---

## 10. ğŸ“‹ å®æ–½æ–¹æ¡ˆä¸æ£€æŸ¥æ¸…å•



### 10.1 æ ‡å‡†åŒ–å®æ–½æ–¹æ¡ˆ



**åˆ†é˜¶æ®µå®æ–½è®¡åˆ’**ï¼š
```
Phase 1: å‡†å¤‡é˜¶æ®µ (2å‘¨)
â”œâ”€ åˆ¶å®šæ ‡å‡†åŒ–æ–‡æ¡£å’Œè§„èŒƒ
â”œâ”€ å‡†å¤‡éƒ¨ç½²æ¨¡æ¿å’Œè„šæœ¬
â”œâ”€ å»ºç«‹é…ç½®ç®¡ç†ä»“åº“
â”œâ”€ æ­å»ºæµ‹è¯•éªŒè¯ç¯å¢ƒ
â””â”€ å›¢é˜ŸåŸ¹è®­å’ŒæŠ€èƒ½æå‡

Phase 2: è¯•ç‚¹å®æ–½ (2å‘¨)  
â”œâ”€ é€‰æ‹©1-2ä¸ªéæ ¸å¿ƒé¡¹ç›®è¯•ç‚¹
â”œâ”€ æŒ‰ç…§æ ‡å‡†æµç¨‹éƒ¨ç½²MySQLå®ä¾‹
â”œâ”€ éªŒè¯æ ‡å‡†åŒ–é…ç½®å’Œæµç¨‹
â”œâ”€ æ”¶é›†åé¦ˆå¹¶ä¼˜åŒ–æ”¹è¿›
â””â”€ ç¼–å†™å®æ–½ç»éªŒæ€»ç»“

Phase 3: é€æ­¥æ¨å¹¿ (4-6å‘¨)
â”œâ”€ æŒ‰ä¸šåŠ¡é‡è¦æ€§åˆ†æ‰¹æ¨å¹¿
â”œâ”€ ç°æœ‰ç¯å¢ƒé€æ­¥æ ‡å‡†åŒ–æ”¹é€ 
â”œâ”€ æ–°å»ºç¯å¢ƒä¸¥æ ¼æŒ‰æ ‡å‡†æ‰§è¡Œ
â”œâ”€ å»ºç«‹ç›‘æ§å’Œåˆè§„æ£€æŸ¥
â””â”€ æŒç»­ä¼˜åŒ–æ ‡å‡†å’Œæµç¨‹

Phase 4: å…¨é¢è¦†ç›– (2-4å‘¨)
â”œâ”€ æ‰€æœ‰MySQLå®ä¾‹æ ‡å‡†åŒ–å®Œæˆ
â”œâ”€ è‡ªåŠ¨åŒ–å·¥å…·å’Œæµç¨‹å®Œå–„
â”œâ”€ ç›‘æ§å‘Šè­¦ä½“ç³»å»ºç«‹
â”œâ”€ æ–‡æ¡£å’ŒçŸ¥è¯†åº“å®Œå–„
â””â”€ å»ºç«‹é•¿æœŸç»´æŠ¤æœºåˆ¶
```

**å®æ–½å›¢é˜Ÿç»„ç»‡**ï¼š
```
é¡¹ç›®ç»„ç»‡æ¶æ„ï¼š
é¡¹ç›®ç»ç† â”€â”€ è´Ÿè´£æ•´ä½“é¡¹ç›®åè°ƒå’Œè¿›åº¦ç®¡ç†
    â”œâ”€ DBAå›¢é˜Ÿ â”€â”€ è´Ÿè´£æŠ€æœ¯æ ‡å‡†åˆ¶å®šå’Œå®æ–½
    â”œâ”€ è¿ç»´å›¢é˜Ÿ â”€â”€ è´Ÿè´£è‡ªåŠ¨åŒ–å·¥å…·å’Œç›‘æ§ä½“ç³»
    â”œâ”€ å¼€å‘å›¢é˜Ÿ â”€â”€ è´Ÿè´£åº”ç”¨é€‚é…å’Œé…åˆæµ‹è¯•
    â”œâ”€ æµ‹è¯•å›¢é˜Ÿ â”€â”€ è´Ÿè´£åŠŸèƒ½å’Œæ€§èƒ½æµ‹è¯•éªŒè¯
    â””â”€ å®‰å…¨å›¢é˜Ÿ â”€â”€ è´Ÿè´£å®‰å…¨åŸºçº¿å’Œåˆè§„æ£€æŸ¥
```

### 10.2 ç¯å¢ƒæ ‡å‡†åŒ–æ£€æŸ¥æ¸…å•



**éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•**ï¼š
```markdown
# MySQLç¯å¢ƒæ ‡å‡†åŒ–éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•


# æœåŠ¡å™¨å‡†å¤‡æ£€æŸ¥


- [ ] æœåŠ¡å™¨ç¡¬ä»¶é…ç½®ç¬¦åˆè¦æ±‚ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- [ ] æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç¬¦åˆæ ‡å‡†ï¼ˆCentOS 7.x / Ubuntu 18.04+ï¼‰
- [ ] ç³»ç»Ÿè¡¥ä¸å·²æ›´æ–°åˆ°æœ€æ–°
- [ ] ç³»ç»Ÿæ—¶é—´åŒæ­¥é…ç½®ï¼ˆNTPï¼‰
- [ ] ä¸»æœºåå’ŒåŸŸåè§£ææ­£ç¡®
- [ ] ç½‘ç»œè¿é€šæ€§æµ‹è¯•é€šè¿‡
- [ ] é˜²ç«å¢™å’Œå®‰å…¨ç»„è§„åˆ™é…ç½®

# ç”¨æˆ·å’Œæƒé™æ£€æŸ¥


- [ ] mysqlç”¨æˆ·å’Œç”¨æˆ·ç»„å·²åˆ›å»º
- [ ] ç›®å½•æƒé™æŒ‰æ ‡å‡†è®¾ç½®
- [ ] sudoæƒé™é…ç½®æ­£ç¡®
- [ ] SSHå¯†é’¥è®¤è¯é…ç½®
- [ ] æ—¥å¿—è½®è½¬é…ç½®

# ä¾èµ–è½¯ä»¶æ£€æŸ¥  


- [ ] å¿…éœ€çš„ç³»ç»Ÿåº“å·²å®‰è£…
- [ ] Python/Perlè¿è¡Œç¯å¢ƒå°±ç»ª
- [ ] ç›‘æ§agentå‡†å¤‡å°±ç»ª
- [ ] å¤‡ä»½å·¥å…·å®‰è£…å®Œæˆ
- [ ] è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·å¯ç”¨

# å­˜å‚¨å’Œç½‘ç»œæ£€æŸ¥


- [ ] ç£ç›˜å®¹é‡æ»¡è¶³è¦æ±‚
- [ ] ç£ç›˜æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] æ–‡ä»¶ç³»ç»Ÿæ ¼å¼æ­£ç¡®ï¼ˆext4/xfsï¼‰
- [ ] æŒ‚è½½ç‚¹é…ç½®æ­£ç¡®
- [ ] ç½‘ç»œå¸¦å®½æ»¡è¶³è¦æ±‚
- [ ] ç«¯å£å¯ç”¨æ€§æ£€æŸ¥
```

**éƒ¨ç½²åéªŒè¯æ¸…å•**ï¼š
```markdown
# MySQLç¯å¢ƒæ ‡å‡†åŒ–éƒ¨ç½²åéªŒè¯æ¸…å•


# æœåŠ¡çŠ¶æ€éªŒè¯


- [ ] MySQLæœåŠ¡å¯åŠ¨æ­£å¸¸
- [ ] æœåŠ¡è‡ªå¯åŠ¨é…ç½®ç”Ÿæ•ˆ
- [ ] è¿›ç¨‹è¿è¡ŒçŠ¶æ€æ­£å¸¸
- [ ] ç«¯å£ç›‘å¬çŠ¶æ€æ­£å¸¸
- [ ] Socketæ–‡ä»¶åˆ›å»ºæ­£ç¡®
- [ ] é”™è¯¯æ—¥å¿—æ— ä¸¥é‡é”™è¯¯

# è¿æ¥å’Œè®¤è¯éªŒè¯


- [ ] rootç”¨æˆ·æœ¬åœ°è¿æ¥æ­£å¸¸
- [ ] ç®¡ç†ç”¨æˆ·è¿œç¨‹è¿æ¥æ­£å¸¸
- [ ] ä¸šåŠ¡ç”¨æˆ·è¿æ¥æƒé™æ­£ç¡®
- [ ] å¯†ç å¤æ‚åº¦ç­–ç•¥ç”Ÿæ•ˆ
- [ ] SSLè¿æ¥æµ‹è¯•é€šè¿‡ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] è¿æ¥æ•°é™åˆ¶æµ‹è¯•æ­£å¸¸

# é…ç½®å‚æ•°éªŒè¯


- [ ] é‡è¦å‚æ•°é…ç½®ç¬¦åˆæ ‡å‡†
- [ ] å­—ç¬¦é›†å’Œæ’åºè§„åˆ™æ­£ç¡®
- [ ] æ—¶åŒºè®¾ç½®æ­£ç¡®
- [ ] æ—¥å¿—é…ç½®å‚æ•°æ­£ç¡®
- [ ] æ€§èƒ½å‚æ•°é…ç½®åˆç†
- [ ] å®‰å…¨å‚æ•°é…ç½®æ­£ç¡®

# åŠŸèƒ½ç‰¹æ€§éªŒè¯


- [ ] æ•°æ®åº“åˆ›å»ºå’Œåˆ é™¤æ­£å¸¸
- [ ] è¡¨åˆ›å»ºå’ŒåŸºæœ¬æ“ä½œæ­£å¸¸
- [ ] äº‹åŠ¡åŠŸèƒ½æ­£å¸¸
- [ ] ç´¢å¼•åˆ›å»ºå’Œä½¿ç”¨æ­£å¸¸
- [ ] å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ­£å¸¸
- [ ] è§¦å‘å™¨åŠŸèƒ½æ­£å¸¸ï¼ˆå¦‚ä½¿ç”¨ï¼‰

# æ—¥å¿—å’Œç›‘æ§éªŒè¯


- [ ] é”™è¯¯æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] äºŒè¿›åˆ¶æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] å®¡è®¡æ—¥å¿—è®°å½•æ­£å¸¸ï¼ˆå¦‚å¯ç”¨ï¼‰
- [ ] ç›‘æ§æ•°æ®é‡‡é›†æ­£å¸¸
- [ ] å‘Šè­¦è§„åˆ™é…ç½®ç”Ÿæ•ˆ

# å¤‡ä»½å’Œæ¢å¤éªŒè¯


- [ ] å¤‡ä»½è„šæœ¬æ‰§è¡Œæ­£å¸¸
- [ ] å¤‡ä»½æ–‡ä»¶ç”Ÿæˆæ­£ç¡®
- [ ] å¤‡ä»½æ–‡ä»¶å¯ç”¨æ€§éªŒè¯
- [ ] æ¢å¤æµç¨‹æµ‹è¯•é€šè¿‡
- [ ] å¤‡ä»½ä¿ç•™ç­–ç•¥ç”Ÿæ•ˆ
- [ ] å¤‡ä»½ç›‘æ§å‘Šè­¦æ­£å¸¸
```

### 10.3 é…ç½®è§„èŒƒæ–‡æ¡£æ¨¡æ¿



**MySQLé…ç½®è§„èŒƒæ–‡æ¡£æ ‡å‡†æ¨¡æ¿**ï¼š
```markdown
# MySQLé…ç½®è§„èŒƒæ–‡æ¡£


# æ–‡æ¡£ä¿¡æ¯


- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-09-01
- **æœ€åæ›´æ–°**: 2025-09-01  
- **ç»´æŠ¤äººå‘˜**: DBAå›¢é˜Ÿ
- **å®¡æ ¸äººå‘˜**: æ¶æ„å¸ˆ
- **é€‚ç”¨èŒƒå›´**: æ‰€æœ‰MySQLå®ä¾‹

# ç‰ˆæœ¬å’Œç¯å¢ƒè¦æ±‚



## æ”¯æŒçš„MySQLç‰ˆæœ¬


- **ç”Ÿäº§ç¯å¢ƒ**: MySQL 8.0.33 (æ¨è)
- **æµ‹è¯•ç¯å¢ƒ**: MySQL 8.0.30+ 
- **å¼€å‘ç¯å¢ƒ**: MySQL 8.0.25+

## æ“ä½œç³»ç»Ÿè¦æ±‚


- **Linux**: CentOS 7.x, Ubuntu 18.04+, RHEL 7.x
- **æœ€å°å†…å­˜**: 4GB (æ¨è8GB+)
- **æœ€å°ç£ç›˜**: 100GB (æ¨èSSD)

# å®‰è£…å’Œç›®å½•è§„èŒƒ



## å®‰è£…è·¯å¾„æ ‡å‡†


```bash
ç¨‹åºç›®å½•: /usr/local/mysql
æ•°æ®ç›®å½•: /var/lib/mysql  
æ—¥å¿—ç›®å½•: /var/log/mysql
é…ç½®ç›®å½•: /etc/mysql
è¿è¡Œç›®å½•: /var/run/mysqld
```

## ç”¨æˆ·å’Œæƒé™æ ‡å‡†


```bash
è¿è¡Œç”¨æˆ·: mysql
è¿è¡Œç”¨æˆ·ç»„: mysql
æ•°æ®ç›®å½•æƒé™: 750
æ—¥å¿—ç›®å½•æƒé™: 750  
é…ç½®æ–‡ä»¶æƒé™: 644
```

# é…ç½®å‚æ•°æ ‡å‡†



## åŸºç¡€é…ç½®æ ‡å‡†


```ini
[mysqld]
# æœåŠ¡é…ç½®

port = 3306
socket = /var/lib/mysql/mysql.sock
datadir = /var/lib/mysql
user = mysql

# å­—ç¬¦é›†é…ç½®

character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# è¿æ¥é…ç½®  

max_connections = 1000
max_connect_errors = 1000000
max_allowed_packet = 64M
```

## ç¯å¢ƒå·®å¼‚åŒ–é…ç½®



### å¼€å‘ç¯å¢ƒé…ç½®


```ini
# æ€§èƒ½ä¼˜åŒ–ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

innodb_buffer_pool_size = 1G
innodb_flush_log_at_trx_commit = 2
sync_binlog = 0
slow_query_log = ON
long_query_time = 2
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®  


```ini
# æ€§èƒ½ä¼˜åŒ–ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

innodb_buffer_pool_size = 8G
innodb_flush_log_at_trx_commit = 1
sync_binlog = 1  
slow_query_log = ON
long_query_time = 1
```

# å®‰å…¨é…ç½®æ ‡å‡†



## è´¦æˆ·å®‰å…¨


- åˆ é™¤é»˜è®¤åŒ¿åç”¨æˆ·
- ç¦ç”¨rootè¿œç¨‹ç™»å½•
- åˆ›å»ºå…·æœ‰æœ€å°æƒé™çš„ä¸šåŠ¡ç”¨æˆ·
- å¯ç”¨å¯†ç å¤æ‚åº¦éªŒè¯

## ç½‘ç»œå®‰å…¨


- å¯ç”¨SSLåŠ å¯†ä¼ è¾“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- é…ç½®é˜²ç«å¢™è§„åˆ™é™åˆ¶è®¿é—®
- ç¦ç”¨ä¸å®‰å…¨åŠŸèƒ½ï¼ˆlocal-infileï¼‰
- å¯ç”¨å®¡è®¡æ—¥å¿—ï¼ˆå¦‚éœ€è¦ï¼‰

# ç›‘æ§å’Œå‘Šè­¦æ ‡å‡†



## å¿…é¡»ç›‘æ§çš„æŒ‡æ ‡


- MySQLæœåŠ¡å¯ç”¨æ€§
- è¿æ¥æ•°ä½¿ç”¨ç‡
- æ…¢æŸ¥è¯¢æ•°é‡
- ä¸»ä»å¤åˆ¶å»¶è¿Ÿ
- ç¼“å†²æ± ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡

## å‘Šè­¦é˜ˆå€¼æ ‡å‡†


- æœåŠ¡ä¸å¯ç”¨: ç«‹å³å‘Šè­¦
- è¿æ¥æ•°ä½¿ç”¨ç‡ > 80%: å‘Šè­¦
- æ…¢æŸ¥è¯¢/ç§’ > 10: å‘Šè­¦
- ä¸»ä»å»¶è¿Ÿ > 10ç§’: å‘Šè­¦

# å¤‡ä»½å’Œæ¢å¤æ ‡å‡†



## å¤‡ä»½ç­–ç•¥


- **å…¨é‡å¤‡ä»½**: æ¯å‘¨ä¸€æ¬¡
- **å¢é‡å¤‡ä»½**: æ¯æ—¥ä¸€æ¬¡
- **å¤‡ä»½ä¿ç•™**: 30å¤©
- **å¤‡ä»½éªŒè¯**: æ¯æœˆä¸€æ¬¡

## æ¢å¤æµ‹è¯•


- **RTOç›®æ ‡**: < 4å°æ—¶
- **RPOç›®æ ‡**: < 1å°æ—¶  
- **æµ‹è¯•é¢‘ç‡**: æ¯å­£åº¦ä¸€æ¬¡
- **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°

# å˜æ›´ç®¡ç†æ ‡å‡†



## é…ç½®å˜æ›´æµç¨‹


1. æäº¤å˜æ›´ç”³è¯·
2. æŠ€æœ¯å®¡æŸ¥è¯„ä¼°
3. ä¸šåŠ¡å½±å“è¯„ä¼°
4. å˜æ›´å®¡æ‰¹
5. æ‰§è¡Œå˜æ›´
6. éªŒè¯ç»“æœ
7. æ›´æ–°æ–‡æ¡£

## ç´§æ€¥å˜æ›´å¤„ç†


- å®šä¹‰ç´§æ€¥å˜æ›´æ ‡å‡†
- ç®€åŒ–å®¡æ‰¹æµç¨‹
- äº‹åè¡¥å……å®Œæ•´æµç¨‹
- åŠæ—¶é£é™©è¯„ä¼°

# æ–‡æ¡£ç»´æŠ¤



## æ–‡æ¡£æ›´æ–°é¢‘ç‡


- **é…ç½®æ ‡å‡†**: æ¯å­£åº¦å®¡æŸ¥
- **æ“ä½œæ‰‹å†Œ**: æ¯æœˆæ›´æ–°
- **æ•…éšœå¤„ç†**: åŠæ—¶æ›´æ–°
- **æœ€ä½³å®è·µ**: æŒç»­ç§¯ç´¯

## æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†


- ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶
- é‡è¦å˜æ›´è®°å½•å˜æ›´æ—¥å¿—
- å®šæœŸå½’æ¡£å†å²ç‰ˆæœ¬
- ç¡®ä¿æ–‡æ¡£å¯è¿½æº¯æ€§


---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ ç¯å¢ƒæ ‡å‡†åŒ–ï¼šç»Ÿä¸€ä¸åŒç¯å¢ƒçš„é…ç½®ã€éƒ¨ç½²ã€è¿ç»´æ ‡å‡†
ğŸ”¸ åŸºç¡€è®¾æ–½å³ä»£ç ï¼šç”¨ä»£ç ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²
ğŸ”¸ é…ç½®ç®¡ç†ï¼šç‰ˆæœ¬æ§åˆ¶ã€å˜æ›´å®¡æ‰¹ã€æ¼‚ç§»æ£€æµ‹çš„å®Œæ•´ä½“ç³»
ğŸ”¸ å®‰å…¨åŸºçº¿ï¼šç»Ÿä¸€çš„å®‰å…¨é…ç½®æ ‡å‡†å’Œåˆè§„æ£€æŸ¥è¦æ±‚
ğŸ”¸ ç›‘æ§æ ‡å‡†ï¼šç»Ÿä¸€çš„ç›‘æ§æŒ‡æ ‡ã€å‘Šè­¦é˜ˆå€¼ã€åˆè§„æ£€æŸ¥
ğŸ”¸ ç¯å¢ƒéš”ç¦»ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„å®‰å…¨éš”ç¦»æœºåˆ¶
ğŸ”¸ è‡ªåŠ¨åŒ–è¿ç»´ï¼šæ ‡å‡†åŒ–çš„éƒ¨ç½²ã€ç›‘æ§ã€å˜æ›´è‡ªåŠ¨åŒ–æµç¨‹
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ç¯å¢ƒæ ‡å‡†åŒ–**
```
è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š
- æ¶ˆé™¤"åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘"çš„ç¯å¢ƒå·®å¼‚é—®é¢˜
- æå‡éƒ¨ç½²æ•ˆç‡ï¼Œå‡å°‘äººä¸ºé”™è¯¯
- é™ä½ç»´æŠ¤æˆæœ¬ï¼Œç»Ÿä¸€è¿ç»´æ ‡å‡†
- æé«˜å®‰å…¨æ€§ï¼Œç»Ÿä¸€å®‰å…¨åŸºçº¿
- ä¾¿äºé—®é¢˜å®šä½ï¼Œç¯å¢ƒä¸€è‡´æ€§ä¿è¯
```

**ğŸ”¹ æ ‡å‡†åŒ–çš„æ ¸å¿ƒåŸåˆ™**
```
ä¸€è‡´æ€§åŸåˆ™ï¼šç›¸åŒç”¨é€”çš„å®ä¾‹ä½¿ç”¨ç›¸åŒé…ç½®
å¯è¿½æº¯åŸåˆ™ï¼šæ‰€æœ‰å˜æ›´éƒ½æœ‰è®°å½•å’Œå®¡æ‰¹
è‡ªåŠ¨åŒ–åŸåˆ™ï¼šå°½å¯èƒ½ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·
æ¸è¿›å¼åŸåˆ™ï¼šåˆ†é˜¶æ®µå®æ–½ï¼Œé€æ­¥å®Œå–„
æŒç»­æ”¹è¿›ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¸æ–­ä¼˜åŒ–
```

**ğŸ”¹ åŸºç¡€è®¾æ–½å³ä»£ç çš„ä»·å€¼**
```
ä¼ ç»Ÿæ–¹å¼é—®é¢˜ï¼š
- æ‰‹å·¥é…ç½®ï¼Œå®¹æ˜“å‡ºé”™ï¼Œéš¾ä»¥å¤åˆ¶
- é…ç½®ä¸ä¸€è‡´ï¼Œç¯å¢ƒå·®å¼‚å¤§
- æ— æ³•ç‰ˆæœ¬æ§åˆ¶ï¼Œå˜æ›´éš¾ä»¥è¿½æº¯

IaCè§£å†³æ–¹æ¡ˆï¼š  
- ä»£ç åŒ–é…ç½®ï¼Œå¯é‡å¤ã€å¯éªŒè¯
- ç‰ˆæœ¬æ§åˆ¶ï¼Œå˜æ›´å¯è¿½æº¯
- è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå‡å°‘äººä¸ºé”™è¯¯
- ç¯å¢ƒä¸€è‡´æ€§å¾—åˆ°ä¿è¯
```

### 11.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ æå‡è¿ç»´æ•ˆç‡**ï¼š
- **æ ‡å‡†åŒ–éƒ¨ç½²**ï¼šæ–°ç¯å¢ƒéƒ¨ç½²æ—¶é—´ä»å¤©çº§åˆ«é™åˆ°å°æ—¶çº§åˆ«
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šå‡å°‘é‡å¤æ€§äººå·¥æ“ä½œï¼Œé™ä½å‡ºé”™æ¦‚ç‡
- **ç»Ÿä¸€ç›‘æ§**ï¼šæ ‡å‡†åŒ–çš„ç›‘æ§ä½“ç³»ï¼Œå¿«é€Ÿå‘ç°å’Œå®šä½é—®é¢˜

**ğŸ”’ å¢å¼ºå®‰å…¨ä¿éšœ**ï¼š
- **å®‰å…¨åŸºçº¿**ï¼šç»Ÿä¸€çš„å®‰å…¨é…ç½®ï¼Œæ¶ˆé™¤å®‰å…¨æ¼æ´
- **æƒé™æ ‡å‡†åŒ–**ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œé™ä½å®‰å…¨é£é™©
- **åˆè§„æ£€æŸ¥**ï¼šè‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥ï¼Œç¡®ä¿æŒç»­åˆè§„

**ğŸ“Š æé«˜å¯ç»´æŠ¤æ€§**ï¼š
- **ç¯å¢ƒä¸€è‡´æ€§**ï¼šé—®é¢˜å®¹æ˜“å¤ç°ï¼Œä¾¿äºå®šä½å’Œè§£å†³
- **æ–‡æ¡£æ ‡å‡†åŒ–**ï¼šå®Œå–„çš„æ–‡æ¡£ä½“ç³»ï¼Œé™ä½å­¦ä¹ æˆæœ¬
- **å˜æ›´ç®¡ç†**ï¼šè§„èŒƒçš„å˜æ›´æµç¨‹ï¼Œå‡å°‘å˜æ›´é£é™©

### 11.4 å®æ–½å»ºè®®å’Œæœ€ä½³å®è·µ



**ğŸ”¸ åˆ†é˜¶æ®µå®æ–½ç­–ç•¥**ï¼š
```
ç¬¬ä¸€é˜¶æ®µï¼šåˆ¶å®šæ ‡å‡†å’Œè§„èŒƒ
- è°ƒç ”ç°çŠ¶ï¼Œè¯†åˆ«æ ‡å‡†åŒ–éœ€æ±‚
- åˆ¶å®šé…ç½®æ ‡å‡†å’Œå®‰å…¨åŸºçº¿
- å‡†å¤‡è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·

ç¬¬äºŒé˜¶æ®µï¼šè¯•ç‚¹éªŒè¯
- é€‰æ‹©éæ ¸å¿ƒä¸šåŠ¡è¯•ç‚¹
- éªŒè¯æ ‡å‡†åŒ–æµç¨‹å’Œå·¥å…·
- æ”¶é›†åé¦ˆå¹¶ä¼˜åŒ–æ”¹è¿›

ç¬¬ä¸‰é˜¶æ®µï¼šé€æ­¥æ¨å¹¿  
- æŒ‰ä¸šåŠ¡é‡è¦æ€§åˆ†æ‰¹æ¨å¹¿
- ç°æœ‰ç¯å¢ƒé€æ­¥æ”¹é€ 
- å»ºç«‹ç›‘æ§å’Œåˆè§„æ£€æŸ¥

ç¬¬å››é˜¶æ®µï¼šæŒç»­ä¼˜åŒ–
- å»ºç«‹é•¿æœŸç»´æŠ¤æœºåˆ¶
- æ ¹æ®ä½¿ç”¨æƒ…å†µæŒç»­ä¼˜åŒ–
- çŸ¥è¯†ç§¯ç´¯å’Œç»éªŒåˆ†äº«
```

**ğŸ”¸ å¸¸è§é™·é˜±å’Œæ³¨æ„äº‹é¡¹**ï¼š
```
è¿‡åº¦æ ‡å‡†åŒ–ï¼š
- é¿å…ä¸€åˆ€åˆ‡ï¼Œè€ƒè™‘ä¸šåŠ¡å·®å¼‚
- é¢„ç•™çµæ´»æ€§ç©ºé—´
- å®šæœŸè¯„ä¼°æ ‡å‡†çš„åˆç†æ€§

å¿½è§†äººå‘˜åŸ¹è®­ï¼š
- æ ‡å‡†åŒ–ä¸åªæ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´æ˜¯ç®¡ç†é—®é¢˜
- å……åˆ†çš„åŸ¹è®­å’Œæ–‡æ¡£æ”¯æ’‘
- å»ºç«‹æ¿€åŠ±æœºåˆ¶æ¨åŠ¨æ‰§è¡Œ

ç¼ºä¹æŒç»­ç»´æŠ¤ï¼š
- æ ‡å‡†åŒ–æ˜¯æŒç»­è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§é¡¹ç›®
- å»ºç«‹å®šæœŸå®¡æŸ¥å’Œæ›´æ–°æœºåˆ¶
- æ ¹æ®æŠ€æœ¯å‘å±•åŠæ—¶è°ƒæ•´æ ‡å‡†
```

**ğŸ”¸ æˆåŠŸå®æ–½çš„å…³é”®å› ç´ **ï¼š
```
ç®¡ç†å±‚æ”¯æŒï¼š
- è·å¾—è¶³å¤Ÿçš„èµ„æºæŠ•å…¥
- å»ºç«‹è·¨å›¢é˜Ÿåä½œæœºåˆ¶
- åˆ¶å®šæ˜ç¡®çš„è€ƒæ ¸æŒ‡æ ‡

æŠ€æœ¯å›¢é˜Ÿé…åˆï¼š
- DBAã€è¿ç»´ã€å¼€å‘å›¢é˜Ÿå¯†åˆ‡é…åˆ
- ç»Ÿä¸€æ€æƒ³è®¤è¯†ï¼Œå½¢æˆåˆåŠ›
- å»ºç«‹çŸ¥è¯†åˆ†äº«æœºåˆ¶

å·¥å…·å’Œè‡ªåŠ¨åŒ–ï¼š
- é€‰æ‹©åˆé€‚çš„è‡ªåŠ¨åŒ–å·¥å…·
- å»ºç«‹å®Œå–„çš„CI/CDæµç¨‹
- æŒç»­ä¼˜åŒ–è‡ªåŠ¨åŒ–è„šæœ¬
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ ‡å‡†ç»Ÿä¸€æ¶ˆå·®å¼‚ï¼Œè‡ªåŠ¨éƒ¨ç½²ææ•ˆç‡
é…ç½®ç®¡ç†è¦ç‰ˆæœ¬ï¼Œå®‰å…¨åŸºçº¿ä¸èƒ½ä¸¢
ç›‘æ§åˆè§„åŒæ­¥èµ°ï¼Œç¯å¢ƒéš”ç¦»ä¿å®‰å…¨
æŒç»­æ”¹è¿›æ˜¯å…³é”®ï¼Œå›¢é˜Ÿé…åˆæœ€é‡è¦
```