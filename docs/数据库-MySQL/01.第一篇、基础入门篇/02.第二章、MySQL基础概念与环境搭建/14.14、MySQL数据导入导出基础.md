---
title: 14、MySQL数据导入导出基础
---
## 📚 目录

1. [数据导入导出基本概念](#1-数据导入导出基本概念)
2. [LOAD DATA INFILE导入详解](#2-LOAD-DATA-INFILE导入详解)
3. [SELECT INTO OUTFILE导出详解](#3-SELECT-INTO-OUTFILE导出详解)
4. [CSV格式数据处理](#4-CSV格式数据处理)
5. [权限与安全配置](#5-权限与安全配置)
6. [实际应用场景与技巧](#6-实际应用场景与技巧)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 📁 数据导入导出基本概念


### 1.1 什么是数据导入导出


**💡 通俗理解**：数据导入导出就像"搬家"
```
数据导出 = 把数据从MySQL"打包"成文件
数据导入 = 把文件中的数据"搬进"MySQL

就像搬家时：
🏠 MySQL数据库 = 房子
📦 数据文件 = 打包的物品
🚚 导入导出工具 = 搬家车
```

### 1.2 为什么需要数据导入导出


**🎯 常见应用场景**
```
数据备份：定期导出数据作为备份
系统迁移：从旧系统迁移数据到新系统
数据分析：导出数据给分析工具处理
批量操作：大量数据的批量插入
数据交换：与其他系统或部门交换数据
```

### 1.3 主要方法对比


**📊 导入导出方法比较**

| 方法 | **导入** | **导出** | **性能** | **适用场景** |
|------|---------|---------|---------|-------------|
| 🔥 **LOAD DATA** | ✅ | ❌ | `极快` | 大批量数据导入 |
| 🔥 **SELECT INTO** | ❌ | ✅ | `极快` | 大批量数据导出 |
| 🛠️ **mysqldump** | ✅ | ✅ | 中等 | 完整备份恢复 |
| 📝 **INSERT语句** | ✅ | ❌ | 较慢 | 少量数据操作 |

---

## 2. 📥 LOAD DATA INFILE导入详解


### 2.1 LOAD DATA基本语法


**🔸 核心语法结构**
```sql
LOAD DATA [LOCAL] INFILE 'file_path'
INTO TABLE table_name
[FIELDS
    [TERMINATED BY 'string']
    [ENCLOSED BY 'char']
    [ESCAPED BY 'char']
]
[LINES
    [STARTING BY 'string']
    [TERMINATED BY 'string']
]
[IGNORE number LINES]
[(column_list)]
```

**💡 语法解释**
```
LOCAL：可选，表示文件在客户端还是服务器端
INFILE：指定要导入的文件路径
INTO TABLE：指定目标表
FIELDS：定义字段分隔符
LINES：定义行分隔符
IGNORE：跳过文件开头的指定行数
column_list：指定导入到哪些列
```

### 2.2 基础导入示例


**📝 准备测试数据**
```
创建测试表：
CREATE TABLE students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    age INT,
    grade VARCHAR(10),
    score DECIMAL(5,2)
);

准备CSV文件(students.csv)：
张三,20,大二,85.5
李四,19,大一,92.0
王五,21,大三,78.5
```

**🔥 基础导入操作**
```sql
-- 最简单的导入
LOAD DATA INFILE '/tmp/students.csv'
INTO TABLE students
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
(name, age, grade, score);

-- 解释：
-- TERMINATED BY ',' ：字段用逗号分隔
-- LINES TERMINATED BY '\n'：行用换行符分隔  
-- (name, age, grade, score)：跳过id列（自动增长）
```

### 2.3 字段分隔符设置详解


**🔸 常用分隔符配置**
```sql
-- CSV格式（逗号分隔）
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
ESCAPED BY '"'

-- TSV格式（制表符分隔）  
FIELDS TERMINATED BY '\t'

-- 管道符分隔
FIELDS TERMINATED BY '|'

-- 固定宽度（无分隔符）
FIELDS TERMINATED BY ''
```

**📊 分隔符使用场景**

| 分隔符类型 | **语法** | **适用场景** | **注意事项** |
|-----------|---------|-------------|-------------|
| 🔸 **逗号** | `','` | Excel导出的CSV | 数据中不能包含逗号 |
| 🔸 **制表符** | `'\t'` | 程序生成的TSV | 数据中不能包含Tab |
| 🔸 **管道符** | `'|'` | 数据库导出 | 较少冲突，推荐使用 |
| 🔸 **自定义** | `':::'` | 特殊格式 | 确保数据中不包含该符号 |

### 2.4 高级导入选项


**🔧 处理特殊情况**
```sql
-- 跳过文件头部（Excel导出常有表头）
LOAD DATA INFILE '/tmp/data.csv'
INTO TABLE students
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
IGNORE 1 LINES  -- 跳过第一行标题
(name, age, grade, score);

-- 处理引号包围的字段
LOAD DATA INFILE '/tmp/data.csv'
INTO TABLE students
FIELDS TERMINATED BY ','
ENCLOSED BY '"'    -- 字段用双引号包围
LINES TERMINATED BY '\n'
(name, age, grade, score);

-- 处理字段中的特殊字符
LOAD DATA INFILE '/tmp/data.csv'
INTO TABLE students
FIELDS TERMINATED BY ','
ESCAPED BY '\\'    -- 反斜杠转义
(name, age, grade, score);
```

### 2.5 LOCAL关键字详解


**🔸 LOCAL的含义**
```sql
-- 服务器端文件（默认）
LOAD DATA INFILE '/tmp/data.csv'
-- 文件必须在MySQL服务器上

-- 客户端文件
LOAD DATA LOCAL INFILE '/home/user/data.csv'  
-- 文件在客户端，会先上传到服务器
```

**⚠️ LOCAL使用注意事项**
```
安全考虑：
• LOCAL可能被禁用（local_infile=OFF）
• 客户端文件会上传到服务器临时目录
• 可能存在安全风险

性能影响：
• LOCAL需要先上传文件，速度较慢
• 大文件建议直接放在服务器端
```

---

## 3. 📤 SELECT INTO OUTFILE导出详解


### 3.1 SELECT INTO OUTFILE基本语法


**🔸 核心语法结构**
```sql
SELECT column_list
INTO OUTFILE 'file_path'
[FIELDS
    [TERMINATED BY 'string']
    [ENCLOSED BY 'char']
    [ESCAPED BY 'char']
]
[LINES TERMINATED BY 'string']
FROM table_name
[WHERE conditions];
```

### 3.2 基础导出示例


**📝 简单导出操作**
```sql
-- 导出全部学生数据
SELECT name, age, grade, score
INTO OUTFILE '/tmp/students_export.csv'
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
FROM students;

-- 生成的文件内容：
-- 张三,20,大二,85.50
-- 李四,19,大一,92.00
-- 王五,21,大三,78.50
```

**🔸 带条件的导出**
```sql
-- 只导出成绩优秀的学生
SELECT name, age, grade, score
INTO OUTFILE '/tmp/excellent_students.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
FROM students
WHERE score >= 90;

-- 生成带引号的CSV：
-- "李四","19","大一","92.00"
```

### 3.3 导出格式控制


**📊 不同格式导出示例**
```sql
-- 标准CSV格式（Excel兼容）
SELECT name, age, grade, score
INTO OUTFILE '/tmp/excel_format.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
ESCAPED BY '"'
LINES TERMINATED BY '\r\n'  -- Windows换行符
FROM students;

-- TSV格式（制表符分隔）
SELECT name, age, grade, score
INTO OUTFILE '/tmp/data.tsv'
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
FROM students;

-- 自定义格式
SELECT CONCAT('姓名：', name, ' 年龄：', age, '岁')
INTO OUTFILE '/tmp/custom_format.txt'
LINES TERMINATED BY '\n'
FROM students;
```

### 3.4 导出进阶技巧


**🎯 实用导出技巧**
```sql
-- 导出时添加表头
(SELECT 'name', 'age', 'grade', 'score')
UNION ALL
(SELECT name, age, grade, score FROM students)
INTO OUTFILE '/tmp/with_header.csv'
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';

-- 导出计算字段
SELECT 
    name,
    age,
    CASE 
        WHEN score >= 90 THEN '优秀'
        WHEN score >= 80 THEN '良好'
        ELSE '一般'
    END as level
INTO OUTFILE '/tmp/student_levels.csv'
FIELDS TERMINATED BY ','
FROM students;
```

---

## 4. 📋 CSV格式数据处理


### 4.1 CSV格式基础知识


**💡 CSV格式本质**
```
CSV = Comma-Separated Values（逗号分隔值）
本质：一种简单的文本格式，用于存储表格数据

基本规则：
• 每行一条记录
• 字段用逗号分隔
• 文本字段可用引号包围
• 引号内的引号需要转义
```

**📊 CSV格式示例**
```
标准CSV格式：
name,age,city
"张三",25,"北京"
"李四",30,"上海"
"王五",28,"深圳"

包含特殊字符的CSV：
name,description,price
"苹果","新鲜的""红富士""苹果",3.50
"香蕉","进口香蕉，很甜",2.80
```

### 4.2 处理CSV中的特殊字符


**🔸 引号处理**
```sql
-- 数据中包含引号的处理
LOAD DATA INFILE '/tmp/products.csv'
INTO TABLE products
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
ESCAPED BY '"'    -- 双引号转义
LINES TERMINATED BY '\n'
(name, description, price);

-- 文件内容示例：
-- "苹果","新鲜的""红富士""苹果",3.50
-- 解析结果：name=苹果, description=新鲜的"红富士"苹果, price=3.50
```

**🔸 换行符处理**
```sql
-- 处理字段内包含换行符的情况
LOAD DATA INFILE '/tmp/comments.csv'
INTO TABLE user_comments  
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
(user_name, comment_text);

-- 文件内容可能是：
-- "张三","这是第一行
-- 这是第二行"
-- "李四","单行评论"
```

### 4.3 不同编码格式处理


**🌐 编码格式转换**
```sql
-- 处理UTF-8编码的CSV
LOAD DATA INFILE '/tmp/utf8_data.csv'
INTO TABLE test_table
CHARACTER SET utf8mb4  -- 指定字符集
FIELDS TERMINATED BY ','
(name, description);

-- 处理GBK编码的文件（先转换编码）
-- 在Linux系统中：
-- iconv -f GBK -t UTF-8 source.csv > utf8_data.csv
```

---

## 5. 🔐 权限与安全配置


### 5.1 导入导出权限要求


**🔑 基本权限需求**
```sql
-- 查看当前用户权限
SHOW GRANTS FOR CURRENT_USER;

-- 导出数据需要的权限：
GRANT SELECT ON database_name.table_name TO 'username'@'host';
GRANT FILE ON *.* TO 'username'@'host';

-- 导入数据需要的权限：
GRANT INSERT ON database_name.table_name TO 'username'@'host';  
GRANT FILE ON *.* TO 'username'@'host';
```

**⚠️ FILE权限说明**
```
FILE权限作用：
• 允许读取服务器上的文件
• 允许写入服务器上的文件
• 是全局权限，不能限制到特定数据库

安全风险：
• 可以读取服务器上任何MySQL有权限的文件
• 可能被恶意利用读取敏感文件
• 生产环境需要谨慎授予
```

### 5.2 安全配置要点


**🛡️ secure_file_priv参数**
```sql
-- 查看当前设置
SHOW VARIABLES LIKE 'secure_file_priv';

-- 三种可能的值：
NULL     ：禁止导入导出文件
''(空值) ：允许导入导出任意位置的文件  
'/path/' ：只允许导入导出指定目录下的文件
```

**📁 安全目录配置示例**
```
在my.cnf中配置：
[mysqld]
secure_file_priv = /var/lib/mysql-files/

作用：
• 只能在/var/lib/mysql-files/目录下进行文件操作
• 防止读取系统敏感文件
• 限制文件写入位置
```

### 5.3 LOCAL INFILE安全设置


**🔸 客户端文件导入控制**
```sql
-- 查看LOCAL INFILE设置
SHOW VARIABLES LIKE 'local_infile';

-- 启用LOCAL INFILE
SET GLOBAL local_infile = ON;

-- 禁用LOCAL INFILE（更安全）
SET GLOBAL local_infile = OFF;
```

**⚠️ 安全建议**
```
生产环境安全配置：
✅ 设置secure_file_priv到专用目录
✅ 关闭local_infile
✅ 严格控制FILE权限授予
✅ 定期审查文件操作日志
❌ 避免给普通用户FILE权限
```

---

## 6. 💼 实际应用场景与技巧


### 6.1 大批量数据导入优化


**⚡ 性能优化技巧**
```sql
-- 临时关闭autocommit提升性能
SET autocommit = 0;

LOAD DATA INFILE '/tmp/large_data.csv'
INTO TABLE large_table
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
(col1, col2, col3, col4);

COMMIT;
SET autocommit = 1;

-- 其他优化选项：
-- 1. 临时关闭外键检查
SET foreign_key_checks = 0;
-- 导入完成后再开启
SET foreign_key_checks = 1;

-- 2. 临时关闭唯一性检查
SET unique_checks = 0;
-- 导入完成后再开启  
SET unique_checks = 1;
```

### 6.2 数据清洗与转换


**🧹 导入时数据处理**
```sql
-- 数据转换示例
LOAD DATA INFILE '/tmp/sales_data.csv'
INTO TABLE sales
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
(product_name, @sale_date, @amount, region)
SET 
    sale_date = STR_TO_DATE(@sale_date, '%Y-%m-%d'),
    amount = ROUND(@amount, 2),
    created_time = NOW();

-- 解释：
-- @sale_date：临时变量，存储原始日期字符串
-- STR_TO_DATE：转换为标准日期格式
-- ROUND：保留两位小数
-- NOW()：设置当前时间
```

### 6.3 错误处理与调试


**🐛 常见错误处理**
```sql
-- 忽略错误行，继续导入
LOAD DATA INFILE '/tmp/data.csv'
INTO TABLE test_table
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(col1, col2, col3);

-- 查看导入结果
SHOW WARNINGS;  -- 查看警告信息
SELECT ROW_COUNT();  -- 查看影响的行数
```

**📊 导入状态监控**
```sql
-- 查看导入进度（大文件导入时）
SHOW PROCESSLIST;

-- 查看导入统计
SELECT 
    'Records' as type, 
    @row_count as count
UNION ALL
SELECT 'Deleted', 0
UNION ALL  
SELECT 'Skipped', @warning_count
UNION ALL
SELECT 'Warnings', $$warning_count;
```

### 6.4 批量导出实战技巧


**📤 分批导出大表**
```sql
-- 按日期分批导出
SELECT * 
INTO OUTFILE '/tmp/orders_2024_01.csv'
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
FROM orders 
WHERE DATE(created_time) BETWEEN '2024-01-01' AND '2024-01-31';

-- 按ID范围分批导出
SELECT *
INTO OUTFILE '/tmp/users_batch_1.csv'  
FIELDS TERMINATED BY ','
FROM users
WHERE id BETWEEN 1 AND 10000;
```

### 6.5 跨系统数据交换


**🔄 与Excel交换数据**
```sql
-- 导出Excel兼容格式
SELECT 
    name as '姓名',
    age as '年龄', 
    grade as '年级',
    score as '成绩'
INTO OUTFILE '/tmp/students_for_excel.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'  -- Windows换行符
FROM students;

-- 处理Excel导出的CSV
LOAD DATA INFILE '/tmp/from_excel.csv'
INTO TABLE students
CHARACTER SET utf8mb4
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES  -- 跳过Excel表头
(name, age, grade, score);
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本概念


```
🔸 LOAD DATA INFILE = MySQL最快的数据导入方法
🔸 SELECT INTO OUTFILE = MySQL原生的数据导出方法
🔸 字段分隔符 = 决定如何解析文件中的数据字段
🔸 FILE权限 = 进行文件操作的必要权限
🔸 secure_file_priv = 控制文件操作的安全目录
🔸 LOCAL关键字 = 区分客户端文件和服务器端文件
```

### 7.2 关键理解要点


**🔹 为什么LOAD DATA这么快**
```
原理：
• 绕过SQL解析器，直接操作存储引擎
• 批量操作，减少单行处理开销
• 最小化事务开销
• 直接文件IO，避免网络传输

性能对比：
INSERT逐行插入：100万行需要30分钟
LOAD DATA批量导入：100万行只需要2分钟
```

**🔹 什么时候用LOAD DATA**
```
适用场景：
✅ 大批量数据导入（万行以上）
✅ 定期的数据同步
✅ 系统迁移时的数据转移
✅ 从Excel等工具导入数据

不适用场景：
❌ 少量数据（几十行）用INSERT更简单
❌ 需要复杂业务逻辑处理
❌ 实时数据插入
```

**🔹 如何选择分隔符**
```
选择原则：
• 确保数据中不包含分隔符字符
• 逗号：最常用，但数据中可能有逗号
• 制表符：较安全，但不可见字符难调试
• 管道符：推荐使用，冲突概率小
• 自定义：特殊场景下使用多字符分隔符
```

### 7.3 实际应用价值


**💼 业务场景应用**
- **数据迁移**：旧系统数据导入新系统
- **报表导出**：定期导出业务数据给业务部门
- **数据备份**：快速备份重要业务数据
- **批量处理**：Excel处理后批量导入系统

**🔧 运维实践**
- **性能优化**：大数据量操作的最佳选择
- **安全配置**：生产环境的权限和目录控制  
- **错误处理**：建立完善的错误监控和处理机制
- **自动化脚本**：结合shell脚本实现自动化数据处理

**核心记忆**：
- LOAD DATA是最快的数据导入方式
- SELECT INTO OUTFILE是原生的导出方法
- 分隔符选择要考虑数据内容特点
- FILE权限是进行文件操作的前提
- 安全配置在生产环境中至关重要