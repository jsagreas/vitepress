---
title: 1ã€å†·å¤‡ä»½æ–¹æ³•
---
## ğŸ“š ç›®å½•

1. [å†·å¤‡ä»½åŸºæœ¬æ¦‚å¿µ](#1-å†·å¤‡ä»½åŸºæœ¬æ¦‚å¿µ)
2. [æ•°æ®åº“åœæœºå¤‡ä»½æµç¨‹](#2-æ•°æ®åº“åœæœºå¤‡ä»½æµç¨‹)
3. [æ–‡ä»¶ç³»ç»Ÿæ‹·è´æŠ€æœ¯](#3-æ–‡ä»¶ç³»ç»Ÿæ‹·è´æŠ€æœ¯)
4. [tarå½’æ¡£å¤‡ä»½æ–¹æ³•](#4-tarå½’æ¡£å¤‡ä»½æ–¹æ³•)
5. [å†·å¤‡ä»½ä¸€è‡´æ€§ä¿è¯](#5-å†·å¤‡ä»½ä¸€è‡´æ€§ä¿è¯)
6. [å¯åœè„šæœ¬è‡ªåŠ¨åŒ–](#6-å¯åœè„šæœ¬è‡ªåŠ¨åŒ–)
7. [å†·å¤‡ä»½æ¢å¤æµç¨‹](#7-å†·å¤‡ä»½æ¢å¤æµç¨‹)
8. [ä¸šåŠ¡å½±å“è¯„ä¼°ä¸ä¼˜åŒ–](#8-ä¸šåŠ¡å½±å“è¯„ä¼°ä¸ä¼˜åŒ–)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ å†·å¤‡ä»½åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å†·å¤‡ä»½


**å†·å¤‡ä»½**æ˜¯æŒ‡åœ¨æ•°æ®åº“å®Œå…¨åœæ­¢è¿è¡ŒçŠ¶æ€ä¸‹è¿›è¡Œçš„å¤‡ä»½æ“ä½œã€‚

> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> å†·å¤‡ä»½å°±åƒç»™ç”µè„‘åšå®Œæ•´çš„ç¡¬ç›˜é•œåƒï¼Œéœ€è¦å…ˆå…³æœºï¼Œç„¶åå®Œæ•´å¤åˆ¶æ‰€æœ‰æ•°æ®æ–‡ä»¶

**å†·å¤‡ä»½çš„æœ¬è´¨ç‰¹å¾**ï¼š
- **æ•°æ®åº“åœæœº**ï¼šMySQLæœåŠ¡å¿…é¡»å®Œå…¨åœæ­¢
- **æ–‡ä»¶çº§å¤åˆ¶**ï¼šç›´æ¥æ‹·è´æ•°æ®åº“æ–‡ä»¶
- **æ•°æ®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ•°æ®å¤„äºé™æ­¢çŠ¶æ€ï¼Œä¿è¯å®Œå…¨ä¸€è‡´
- **å®Œæ•´å¤‡ä»½**ï¼šåŒ…å«æ‰€æœ‰æ•°æ®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€é…ç½®æ–‡ä»¶

### 1.2 å†·å¤‡ä»½ä¸å…¶ä»–å¤‡ä»½æ–¹å¼å¯¹æ¯”


```
å¤‡ä»½æ–¹å¼å¯¹æ¯”ï¼š

å†·å¤‡ä»½ï¼ˆCold Backupï¼‰ï¼š
æ•°æ®åº“çŠ¶æ€ï¼šåœæœº âŒ
æ•°æ®ä¸€è‡´æ€§ï¼š100% âœ…
å¤‡ä»½é€Ÿåº¦ï¼šæœ€å¿« ğŸš€
ä¸šåŠ¡å½±å“ï¼šå®Œå…¨ä¸­æ–­ âš ï¸

çƒ­å¤‡ä»½ï¼ˆHot Backupï¼‰ï¼š
æ•°æ®åº“çŠ¶æ€ï¼šè¿è¡Œä¸­ âœ…
æ•°æ®ä¸€è‡´æ€§ï¼šéœ€è¦ç‰¹æ®Šå¤„ç† âš–ï¸
å¤‡ä»½é€Ÿåº¦ï¼šè¾ƒæ…¢ ğŸŒ
ä¸šåŠ¡å½±å“ï¼šæœ€å° ğŸ’š

æ¸©å¤‡ä»½ï¼ˆWarm Backupï¼‰ï¼š
æ•°æ®åº“çŠ¶æ€ï¼šåªè¯»æ¨¡å¼ ğŸ“–
æ•°æ®ä¸€è‡´æ€§ï¼šè‰¯å¥½ âœ…
å¤‡ä»½é€Ÿåº¦ï¼šä¸­ç­‰ âš¡
ä¸šåŠ¡å½±å“ï¼šéƒ¨åˆ†é™åˆ¶ ğŸŸ¡
```

### 1.3 å†·å¤‡ä»½é€‚ç”¨åœºæ™¯


**æœ€é€‚åˆçš„ä¸šåŠ¡åœºæ™¯**ï¼š
- ğŸŒ™ **ç»´æŠ¤çª—å£**ï¼šæœ‰å›ºå®šçš„åœæœºç»´æŠ¤æ—¶é—´
- ğŸ¢ **å†…éƒ¨ç³»ç»Ÿ**ï¼šé7Ã—24å°æ—¶è¿è¡Œçš„ä¸šåŠ¡ç³»ç»Ÿ
- ğŸ“Š **æ•°æ®ä»“åº“**ï¼šç¦»çº¿åˆ†æç³»ç»Ÿï¼Œå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜
- ğŸ”§ **å¼€å‘æµ‹è¯•**ï¼šå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒçš„æ•°æ®å¤‡ä»½

---

## 2. â¹ï¸ æ•°æ®åº“åœæœºå¤‡ä»½æµç¨‹


### 2.1 æ ‡å‡†åœæœºæµç¨‹


æ•°æ®åº“å®‰å…¨åœæœºæ˜¯å†·å¤‡ä»½çš„å‰ææ¡ä»¶ï¼Œå¿…é¡»æŒ‰æ­£ç¡®é¡ºåºæ‰§è¡Œã€‚

**å®Œæ•´åœæœºæ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥å½“å‰è¿æ¥çŠ¶æ€
mysql -u root -p -e "SHOW PROCESSLIST;"

# 2. ç¦æ­¢æ–°è¿æ¥ï¼ˆå¯é€‰ï¼‰
mysql -u root -p -e "SET GLOBAL read_only = ON;"

# 3. ç­‰å¾…å½“å‰äº‹åŠ¡å®Œæˆ
mysql -u root -p -e "SELECT COUNT(*) FROM information_schema.processlist WHERE command != 'Sleep';"

# 4. å®‰å…¨åœæ­¢MySQLæœåŠ¡
sudo systemctl stop mysql
# æˆ–è€…
sudo service mysql stop

# 5. ç¡®è®¤è¿›ç¨‹å·²åœæ­¢
ps aux | grep mysql
```

### 2.2 åœæœºå‰æ£€æŸ¥æ¸…å•


åœæœºå‰å¿…é¡»ç¡®è®¤çš„å…³é”®çŠ¶æ€ï¼š

> ğŸ“‹ **åœæœºæ£€æŸ¥æ¸…å•**
> - [ ] ç¡®è®¤æ‰€æœ‰é‡è¦äº‹åŠ¡å·²æäº¤
> - [ ] æ£€æŸ¥æ˜¯å¦æœ‰é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
> - [ ] ç¡®è®¤ä»åº“åŒæ­¥çŠ¶æ€ï¼ˆä¸»ä»ç¯å¢ƒï¼‰
> - [ ] å¤‡ä»½å½“å‰äºŒè¿›åˆ¶æ—¥å¿—ä½ç½®
> - [ ] è®°å½•å½“å‰æ•°æ®åº“çŠ¶æ€ä¿¡æ¯

```sql
-- æ£€æŸ¥æœªæäº¤äº‹åŠ¡
SELECT trx_id, trx_state, trx_started 
FROM information_schema.innodb_trx;

-- æ£€æŸ¥ä¸»ä»åŒæ­¥çŠ¶æ€ï¼ˆä¸»åº“ï¼‰
SHOW MASTER STATUS;

-- æ£€æŸ¥ä¸»ä»åŒæ­¥çŠ¶æ€ï¼ˆä»åº“ï¼‰
SHOW SLAVE STATUS\G
```

### 2.3 æœåŠ¡ä¾èµ–å…³ç³»ç®¡ç†


åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼ŒMySQLé€šå¸¸ä¸æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œéœ€è¦è€ƒè™‘ç›¸å…³æœåŠ¡çš„ä¾èµ–å…³ç³»ã€‚

**ä¾èµ–å…³ç³»å¤„ç†é¡ºåº**ï¼š

```
åœæœºé¡ºåºï¼š
åº”ç”¨æœåŠ¡ â†’ WebæœåŠ¡å™¨ â†’ MySQLæ•°æ®åº“ â†’ ç›¸å…³ä¸­é—´ä»¶

å¯åŠ¨é¡ºåºï¼š
ç›¸å…³ä¸­é—´ä»¶ â†’ MySQLæ•°æ®åº“ â†’ WebæœåŠ¡å™¨ â†’ åº”ç”¨æœåŠ¡
```

---

## 3. ğŸ“ æ–‡ä»¶ç³»ç»Ÿæ‹·è´æŠ€æœ¯


### 3.1 MySQLæ•°æ®æ–‡ä»¶ç»“æ„


åœ¨è¿›è¡Œæ–‡ä»¶æ‹·è´å‰ï¼Œéœ€è¦äº†è§£MySQLçš„æ–‡ä»¶ç»„ç»‡ç»“æ„ã€‚

**MySQLä¸»è¦æ–‡ä»¶ç±»å‹**ï¼š

```
MySQLæ•°æ®ç›®å½•ç»“æ„ï¼š
/var/lib/mysql/
â”œâ”€â”€ mysql/              # ç³»ç»Ÿæ•°æ®åº“
â”œâ”€â”€ performance_schema/ # æ€§èƒ½ç›‘æ§æ•°æ®åº“
â”œâ”€â”€ sys/               # ç³»ç»Ÿè§†å›¾æ•°æ®åº“
â”œâ”€â”€ your_database/     # ä¸šåŠ¡æ•°æ®åº“
â”‚   â”œâ”€â”€ table1.ibd    # InnoDBè¡¨æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ table1.frm    # è¡¨ç»“æ„æ–‡ä»¶ï¼ˆMySQL 5.7åŠä»¥å‰ï¼‰
â”œâ”€â”€ ib_logfile0       # InnoDBé‡åšæ—¥å¿—
â”œâ”€â”€ ib_logfile1       # InnoDBé‡åšæ—¥å¿—
â”œâ”€â”€ ibdata1           # InnoDBç³»ç»Ÿè¡¨ç©ºé—´
â”œâ”€â”€ mysql-bin.000001  # äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ mysql-bin.index   # äºŒè¿›åˆ¶æ—¥å¿—ç´¢å¼•
â””â”€â”€ my.cnf            # é…ç½®æ–‡ä»¶ï¼ˆå¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼‰
```

### 3.2 åŸºç¡€æ–‡ä»¶æ‹·è´æ–¹æ³•


æœ€ç®€å•ç›´æ¥çš„å¤‡ä»½æ–¹æ³•æ˜¯ä½¿ç”¨ç³»ç»Ÿçš„æ‹·è´å‘½ä»¤ã€‚

**ä½¿ç”¨cpå‘½ä»¤å¤‡ä»½**ï¼š

```bash
#!/bin/bash
# åŸºç¡€æ–‡ä»¶æ‹·è´å¤‡ä»½è„šæœ¬

# å®šä¹‰è·¯å¾„å˜é‡
MYSQL_DATA_DIR="/var/lib/mysql"
BACKUP_DIR="/backup/mysql/$(date +%Y%m%d_%H%M%S)"
LOG_FILE="/var/log/mysql_backup.log"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "$BACKUP_DIR"

# è®°å½•å¤‡ä»½å¼€å§‹æ—¶é—´
echo "$(date): å¼€å§‹å†·å¤‡ä»½" >> "$LOG_FILE"

# æ‰§è¡Œæ–‡ä»¶æ‹·è´
cp -r "$MYSQL_DATA_DIR" "$BACKUP_DIR/"

# è®°å½•å¤‡ä»½å®Œæˆæ—¶é—´
echo "$(date): å†·å¤‡ä»½å®Œæˆï¼Œå¤‡ä»½ä½ç½®: $BACKUP_DIR" >> "$LOG_FILE"
```

### 3.3 æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–æŠ€æœ¯


ä¸ºäº†æé«˜å¤‡ä»½æ•ˆç‡ï¼Œå¯ä»¥é‡‡ç”¨ä¸€äº›æ–‡ä»¶ç³»ç»Ÿçº§åˆ«çš„ä¼˜åŒ–æŠ€æœ¯ã€‚

**ä½¿ç”¨rsyncè¿›è¡Œå¢é‡å¤‡ä»½**ï¼š

```bash
#!/bin/bash
# rsyncä¼˜åŒ–å¤‡ä»½è„šæœ¬

MYSQL_DATA_DIR="/var/lib/mysql"
BACKUP_BASE_DIR="/backup/mysql"
CURRENT_BACKUP="$BACKUP_BASE_DIR/current"

# åˆ›å»ºç¡¬é“¾æ¥å¤‡ä»½ï¼ˆèŠ‚çœç©ºé—´ï¼‰
if [ -d "$CURRENT_BACKUP" ]; then
    BACKUP_DIR="$BACKUP_BASE_DIR/$(date +%Y%m%d_%H%M%S)"
    
    # ä½¿ç”¨ç¡¬é“¾æ¥åˆ›å»ºåŸºç¡€å¤‡ä»½
    cp -al "$CURRENT_BACKUP" "$BACKUP_DIR"
    
    # ä½¿ç”¨rsyncåŒæ­¥å˜åŒ–çš„æ–‡ä»¶
    rsync -av --delete "$MYSQL_DATA_DIR/" "$BACKUP_DIR/"
    
    # æ›´æ–°å½“å‰å¤‡ä»½é“¾æ¥
    rm -f "$CURRENT_BACKUP"
    ln -s "$BACKUP_DIR" "$CURRENT_BACKUP"
else
    # é¦–æ¬¡å¤‡ä»½
    rsync -av "$MYSQL_DATA_DIR/" "$CURRENT_BACKUP/"
fi
```

---

## 4. ğŸ“¦ tarå½’æ¡£å¤‡ä»½æ–¹æ³•


### 4.1 åŸºç¡€tarå¤‡ä»½


tarå‘½ä»¤å¯ä»¥å°†å¤šä¸ªæ–‡ä»¶å’Œç›®å½•æ‰“åŒ…æˆå•ä¸ªå½’æ¡£æ–‡ä»¶ï¼Œä¾¿äºç®¡ç†å’Œä¼ è¾“ã€‚

**åŸºç¡€tarå¤‡ä»½å‘½ä»¤**ï¼š

```bash
#!/bin/bash
# taråŸºç¡€å¤‡ä»½è„šæœ¬

MYSQL_DATA_DIR="/var/lib/mysql"
BACKUP_DIR="/backup/mysql"
BACKUP_NAME="mysql_backup_$(date +%Y%m%d_%H%M%S).tar"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "$BACKUP_DIR"

# åˆ›å»ºtarå½’æ¡£
tar -cf "$BACKUP_DIR/$BACKUP_NAME" -C "$(dirname $MYSQL_DATA_DIR)" "$(basename $MYSQL_DATA_DIR)"

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR/$BACKUP_NAME"
```

### 4.2 å‹ç¼©å­˜å‚¨ç­–ç•¥


ä¸ºäº†èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé€šå¸¸ä¼šå¯¹å¤‡ä»½æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚

**ä¸åŒå‹ç¼©ç®—æ³•å¯¹æ¯”**ï¼š

| å‹ç¼©ç®—æ³• | **å‹ç¼©ç‡** | **é€Ÿåº¦** | **CPUå ç”¨** | **æ¨èåœºæ™¯** |
|---------|-----------|---------|------------|-------------|
| `gzip` | `ä¸­ç­‰(60-70%)` | `å¿«` | `ä½` | `æ—¥å¸¸å¤‡ä»½` |
| `bzip2` | `é«˜(50-60%)` | `æ…¢` | `ä¸­` | `é•¿æœŸå­˜å‚¨` |
| `xz` | `æœ€é«˜(40-50%)` | `æœ€æ…¢` | `é«˜` | `å½’æ¡£å­˜å‚¨` |
| `lz4` | `ä½(70-80%)` | `æœ€å¿«` | `æœ€ä½` | `é¢‘ç¹å¤‡ä»½` |

**å‹ç¼©å¤‡ä»½å®ç°**ï¼š

```bash
#!/bin/bash
# å‹ç¼©å¤‡ä»½è„šæœ¬

MYSQL_DATA_DIR="/var/lib/mysql"
BACKUP_DIR="/backup/mysql"
BACKUP_NAME="mysql_backup_$(date +%Y%m%d_%H%M%S)"

# æ ¹æ®éœ€æ±‚é€‰æ‹©å‹ç¼©æ–¹å¼
COMPRESS_TYPE="gzip"  # å¯é€‰: gzip, bzip2, xz, lz4

case $COMPRESS_TYPE in
    "gzip")
        tar -czf "$BACKUP_DIR/$BACKUP_NAME.tar.gz" -C "$(dirname $MYSQL_DATA_DIR)" "$(basename $MYSQL_DATA_DIR)"
        ;;
    "bzip2")
        tar -cjf "$BACKUP_DIR/$BACKUP_NAME.tar.bz2" -C "$(dirname $MYSQL_DATA_DIR)" "$(basename $MYSQL_DATA_DIR)"
        ;;
    "xz")
        tar -cJf "$BACKUP_DIR/$BACKUP_NAME.tar.xz" -C "$(dirname $MYSQL_DATA_DIR)" "$(basename $MYSQL_DATA_DIR)"
        ;;
    *)
        tar -cf "$BACKUP_DIR/$BACKUP_NAME.tar" -C "$(dirname $MYSQL_DATA_DIR)" "$(basename $MYSQL_DATA_DIR)"
        ;;
esac
```

### 4.3 å¹¶è¡Œå¤„ç†æŠ€æœ¯


å¯¹äºå¤§å‹æ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨å¹¶è¡Œå‹ç¼©æŠ€æœ¯æé«˜å¤‡ä»½é€Ÿåº¦ã€‚

**å¹¶è¡Œtarå¤‡ä»½**ï¼š

```bash
#!/bin/bash
# å¹¶è¡Œå‹ç¼©å¤‡ä»½è„šæœ¬

MYSQL_DATA_DIR="/var/lib/mysql"
BACKUP_DIR="/backup/mysql"
BACKUP_NAME="mysql_backup_$(date +%Y%m%d_%H%M%S)"

# ä½¿ç”¨pigzè¿›è¡Œå¹¶è¡Œgzipå‹ç¼©
if command -v pigz &> /dev/null; then
    tar -c -C "$(dirname $MYSQL_DATA_DIR)" "$(basename $MYSQL_DATA_DIR)" | pigz > "$BACKUP_DIR/$BACKUP_NAME.tar.gz"
else
    # å›é€€åˆ°æ ‡å‡†gzip
    tar -czf "$BACKUP_DIR/$BACKUP_NAME.tar.gz" -C "$(dirname $MYSQL_DATA_DIR)" "$(basename $MYSQL_DATA_DIR)"
fi
```

---

## 5. âœ… å†·å¤‡ä»½ä¸€è‡´æ€§ä¿è¯


### 5.1 ä¸€è‡´æ€§çš„é‡è¦æ€§


æ•°æ®ä¸€è‡´æ€§æ˜¯å¤‡ä»½å¯ç”¨æ€§çš„å…³é”®ï¼Œä¸ä¸€è‡´çš„å¤‡ä»½å¯èƒ½å¯¼è‡´æ¢å¤å¤±è´¥æˆ–æ•°æ®ä¸¢å¤±ã€‚

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> ä¸€è‡´æ€§å°±åƒæ‹å…¨å®¶ç¦ï¼Œæ‰€æœ‰äººå¿…é¡»åœ¨åŒä¸€æ—¶åˆ»åœæ­¢åŠ¨ä½œï¼Œå¦åˆ™ç…§ç‰‡å°±ä¼šæ¨¡ç³Š

**ä¸€è‡´æ€§é—®é¢˜çš„æ ¹æº**ï¼š
- ğŸ“ **å†™å…¥ä¸­æ–­**ï¼šå¤‡ä»½è¿‡ç¨‹ä¸­æ–‡ä»¶æ­£åœ¨è¢«ä¿®æ”¹
- ğŸ”„ **äº‹åŠ¡æœªå®Œæˆ**ï¼šå¤‡ä»½æ—¶åˆ»æœ‰æœªæäº¤çš„äº‹åŠ¡
- ğŸ“Š **ç¼“å­˜æ•°æ®**ï¼šå†…å­˜ä¸­çš„æ•°æ®æœªåŠæ—¶å†™å…¥ç£ç›˜

### 5.2 InnoDBä¸€è‡´æ€§æœºåˆ¶


InnoDBå­˜å‚¨å¼•æ“é€šè¿‡ç‰¹å®šæœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

**InnoDBä¸€è‡´æ€§è¦ç´ **ï¼š

```sql
-- å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰è„é¡µåˆ°ç£ç›˜
SET GLOBAL innodb_fast_shutdown = 0;

-- æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤äº‹åŠ¡
SELECT COUNT(*) FROM information_schema.innodb_trx;

-- æŸ¥çœ‹å½“å‰LSNï¼ˆæ—¥å¿—åºåˆ—å·ï¼‰
SHOW ENGINE INNODB STATUS;
```

**ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬**ï¼š

```bash
#!/bin/bash
# ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬

check_consistency() {
    echo "æ£€æŸ¥æ•°æ®åº“ä¸€è‡´æ€§..."
    
    # æ£€æŸ¥InnoDBçŠ¶æ€
    mysql -u root -p -e "
        SELECT 
            CASE 
                WHEN COUNT(*) = 0 THEN 'æ— æœªæäº¤äº‹åŠ¡'
                ELSE CONCAT('å­˜åœ¨', COUNT(*), 'ä¸ªæœªæäº¤äº‹åŠ¡')
            END as transaction_status
        FROM information_schema.innodb_trx;
    "
    
    # å¼ºåˆ¶åˆ·æ–°ç¼“å†²æ± 
    mysql -u root -p -e "SET GLOBAL innodb_fast_shutdown = 0;"
    
    echo "ä¸€è‡´æ€§æ£€æŸ¥å®Œæˆ"
}
```

### 5.3 å®Œæ•´æ€§éªŒè¯æœºåˆ¶


å¤‡ä»½å®Œæˆåï¼Œéœ€è¦éªŒè¯å¤‡ä»½æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚

**å¤‡ä»½å®Œæ•´æ€§éªŒè¯**ï¼š

```bash
#!/bin/bash
# å¤‡ä»½å®Œæ•´æ€§éªŒè¯è„šæœ¬

verify_backup() {
    local backup_file="$1"
    
    echo "éªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§..."
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if [ ! -f "$backup_file" ]; then
        echo "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨"
        return 1
    fi
    
    # éªŒè¯taræ–‡ä»¶å®Œæ•´æ€§
    if [[ "$backup_file" == *.tar.gz ]]; then
        if ! tar -tzf "$backup_file" > /dev/null 2>&1; then
            echo "é”™è¯¯: tar.gzæ–‡ä»¶æŸå"
            return 1
        fi
    elif [[ "$backup_file" == *.tar ]]; then
        if ! tar -tf "$backup_file" > /dev/null 2>&1; then
            echo "é”™è¯¯: taræ–‡ä»¶æŸå"
            return 1
        fi
    fi
    
    # è®¡ç®—å¹¶è®°å½•æ ¡éªŒå’Œ
    local checksum=$(sha256sum "$backup_file" | cut -d' ' -f1)
    echo "$checksum $backup_file" > "${backup_file}.sha256"
    
    echo "å¤‡ä»½éªŒè¯å®Œæˆï¼Œæ ¡éªŒå’Œ: $checksum"
    return 0
}
```

---

## 6. ğŸ¤– å¯åœè„šæœ¬è‡ªåŠ¨åŒ–


### 6.1 è‡ªåŠ¨åŒ–è„šæœ¬è®¾è®¡


è‡ªåŠ¨åŒ–å¯ä»¥å‡å°‘äººå·¥æ“ä½œé”™è¯¯ï¼Œæé«˜å¤‡ä»½çš„å¯é æ€§å’Œæ•ˆç‡ã€‚

**å®Œæ•´è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬**ï¼š

```bash
#!/bin/bash
# MySQLå†·å¤‡ä»½è‡ªåŠ¨åŒ–è„šæœ¬

# é…ç½®å‚æ•°
MYSQL_USER="root"
MYSQL_PASSWORD=""  # å»ºè®®ä½¿ç”¨.my.cnfæ–‡ä»¶å­˜å‚¨å¯†ç 
MYSQL_DATA_DIR="/var/lib/mysql"
BACKUP_DIR="/backup/mysql"
LOG_FILE="/var/log/mysql_backup.log"
RETENTION_DAYS=7

# æ—¥å¿—å‡½æ•°
log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S'): $1" | tee -a "$LOG_FILE"
}

# åœæ­¢MySQLæœåŠ¡
stop_mysql() {
    log_message "æ­£åœ¨åœæ­¢MySQLæœåŠ¡..."
    
    if systemctl stop mysql; then
        log_message "MySQLæœåŠ¡å·²åœæ­¢"
        return 0
    else
        log_message "é”™è¯¯: æ— æ³•åœæ­¢MySQLæœåŠ¡"
        return 1
    fi
}

# å¯åŠ¨MySQLæœåŠ¡
start_mysql() {
    log_message "æ­£åœ¨å¯åŠ¨MySQLæœåŠ¡..."
    
    if systemctl start mysql; then
        log_message "MySQLæœåŠ¡å·²å¯åŠ¨"
        return 0
    else
        log_message "é”™è¯¯: æ— æ³•å¯åŠ¨MySQLæœåŠ¡"
        return 1
    fi
}

# æ‰§è¡Œå¤‡ä»½
perform_backup() {
    local backup_name="mysql_backup_$(date +%Y%m%d_%H%M%S).tar.gz"
    local backup_path="$BACKUP_DIR/$backup_name"
    
    log_message "å¼€å§‹æ‰§è¡Œå¤‡ä»½: $backup_name"
    
    mkdir -p "$BACKUP_DIR"
    
    if tar -czf "$backup_path" -C "$(dirname $MYSQL_DATA_DIR)" "$(basename $MYSQL_DATA_DIR)"; then
        log_message "å¤‡ä»½å®Œæˆ: $backup_path"
        
        # éªŒè¯å¤‡ä»½
        if tar -tzf "$backup_path" > /dev/null 2>&1; then
            log_message "å¤‡ä»½éªŒè¯æˆåŠŸ"
        else
            log_message "è­¦å‘Š: å¤‡ä»½éªŒè¯å¤±è´¥"
            return 1
        fi
    else
        log_message "é”™è¯¯: å¤‡ä»½å¤±è´¥"
        return 1
    fi
}

# æ¸…ç†æ—§å¤‡ä»½
cleanup_old_backups() {
    log_message "æ¸…ç†è¶…è¿‡ ${RETENTION_DAYS} å¤©çš„æ—§å¤‡ä»½..."
    
    find "$BACKUP_DIR" -name "mysql_backup_*.tar.gz" -mtime +$RETENTION_DAYS -delete
    
    log_message "æ—§å¤‡ä»½æ¸…ç†å®Œæˆ"
}

# ä¸»æ‰§è¡Œæµç¨‹
main() {
    log_message "=== å¼€å§‹MySQLå†·å¤‡ä»½ ==="
    
    # åœæ­¢æœåŠ¡
    if ! stop_mysql; then
        exit 1
    fi
    
    # æ‰§è¡Œå¤‡ä»½
    if ! perform_backup; then
        start_mysql  # å¤‡ä»½å¤±è´¥ä¹Ÿè¦å¯åŠ¨æœåŠ¡
        exit 1
    fi
    
    # å¯åŠ¨æœåŠ¡
    if ! start_mysql; then
        exit 1
    fi
    
    # æ¸…ç†æ—§å¤‡ä»½
    cleanup_old_backups
    
    log_message "=== MySQLå†·å¤‡ä»½å®Œæˆ ==="
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
```

### 6.2 åœæœºçª—å£æœ€å°åŒ–


åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéœ€è¦å°½å¯èƒ½ç¼©çŸ­æ•°æ®åº“åœæœºæ—¶é—´ã€‚

**å¿«é€Ÿå†·å¤‡ä»½ç­–ç•¥**ï¼š

```bash
#!/bin/bash
# å¿«é€Ÿå†·å¤‡ä»½ä¼˜åŒ–è„šæœ¬

# é¢„åˆ›å»ºå¤‡ä»½ç›®å½•å’Œä¸´æ—¶ç©ºé—´
prepare_backup_env() {
    local backup_dir="$1"
    
    # ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨ä¸”æœ‰è¶³å¤Ÿç©ºé—´
    mkdir -p "$backup_dir"
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    local available_space=$(df "$backup_dir" | tail -1 | awk '{print $4}')
    local required_space=$(du -s "$MYSQL_DATA_DIR" | awk '{print $1}')
    
    if [ "$available_space" -lt "$((required_space * 2))" ]; then
        echo "è­¦å‘Š: å¤‡ä»½ç©ºé—´å¯èƒ½ä¸è¶³"
        return 1
    fi
    
    return 0
}

# ä½¿ç”¨å¿«é€Ÿæ‹·è´æ–¹æ³•
fast_copy_backup() {
    local source_dir="$1"
    local backup_dir="$2"
    
    # ä½¿ç”¨cpçš„å¿«é€Ÿé€‰é¡¹
    # -a: ä¿æŒæ‰€æœ‰å±æ€§
    # -x: ä¸è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œ
    cp -ax "$source_dir" "$backup_dir/"
}
```

### 6.3 ç›‘æ§æŒ‡æ ‡è®¾è®¡


å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ï¼ŒåŠæ—¶å‘ç°å¤‡ä»½è¿‡ç¨‹ä¸­çš„é—®é¢˜ã€‚

**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

```bash
# å¤‡ä»½ç›‘æ§æŒ‡æ ‡æ”¶é›†è„šæœ¬
collect_backup_metrics() {
    local backup_start_time="$1"
    local backup_end_time="$2"
    local backup_file="$3"
    
    # è®¡ç®—å¤‡ä»½è€—æ—¶
    local duration=$((backup_end_time - backup_start_time))
    
    # è·å–å¤‡ä»½æ–‡ä»¶å¤§å°
    local backup_size=$(du -h "$backup_file" | cut -f1)
    
    # è®¡ç®—å¤‡ä»½é€Ÿåº¦
    local backup_speed=$(($(stat -c%s "$backup_file") / duration))
    
    # è¾“å‡ºç›‘æ§æŒ‡æ ‡
    cat << EOF
å¤‡ä»½ç›‘æ§æŒ‡æ ‡:
- å¤‡ä»½å¼€å§‹æ—¶é—´: $(date -d "@$backup_start_time")
- å¤‡ä»½ç»“æŸæ—¶é—´: $(date -d "@$backup_end_time")
- å¤‡ä»½è€—æ—¶: ${duration}ç§’
- å¤‡ä»½æ–‡ä»¶å¤§å°: $backup_size
- å¹³å‡å¤‡ä»½é€Ÿåº¦: $((backup_speed / 1024 / 1024))MB/s
EOF
}
```

---

## 7. ğŸ”„ å†·å¤‡ä»½æ¢å¤æµç¨‹


### 7.1 æ¢å¤å‰å‡†å¤‡å·¥ä½œ


æ•°æ®æ¢å¤æ˜¯ä¸€ä¸ªé«˜é£é™©æ“ä½œï¼Œéœ€è¦å……åˆ†çš„å‡†å¤‡å’ŒéªŒè¯ã€‚

**æ¢å¤å‰æ£€æŸ¥æ¸…å•**ï¼š

> ğŸ“‹ **æ¢å¤å‡†å¤‡æ¸…å•**
> - [ ] ç¡®è®¤å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
> - [ ] åœæ­¢å½“å‰MySQLæœåŠ¡
> - [ ] å¤‡ä»½å½“å‰æ•°æ®ç›®å½•ï¼ˆä»¥é˜²æ¢å¤å¤±è´¥ï¼‰
> - [ ] ç¡®è®¤ç£ç›˜ç©ºé—´å……è¶³
> - [ ] è®°å½•å½“å‰ç³»ç»ŸçŠ¶æ€

```bash
#!/bin/bash
# æ¢å¤å‰å‡†å¤‡è„šæœ¬

prepare_restore() {
    local backup_file="$1"
    
    echo "=== æ¢å¤å‰å‡†å¤‡å·¥ä½œ ==="
    
    # 1. éªŒè¯å¤‡ä»½æ–‡ä»¶
    if [ ! -f "$backup_file" ]; then
        echo "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨"
        return 1
    fi
    
    # 2. éªŒè¯å¤‡ä»½å®Œæ•´æ€§
    if [[ "$backup_file" == *.tar.gz ]]; then
        if ! tar -tzf "$backup_file" > /dev/null 2>&1; then
            echo "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå"
            return 1
        fi
    fi
    
    # 3. åœæ­¢MySQLæœåŠ¡
    if systemctl is-active --quiet mysql; then
        echo "åœæ­¢MySQLæœåŠ¡..."
        systemctl stop mysql
    fi
    
    # 4. å¤‡ä»½å½“å‰æ•°æ®
    if [ -d "$MYSQL_DATA_DIR" ]; then
        local current_backup="/tmp/mysql_current_$(date +%Y%m%d_%H%M%S)"
        echo "å¤‡ä»½å½“å‰æ•°æ®åˆ°: $current_backup"
        mv "$MYSQL_DATA_DIR" "$current_backup"
    fi
    
    echo "å‡†å¤‡å·¥ä½œå®Œæˆ"
    return 0
}
```

### 7.2 æ•°æ®æ¢å¤æ‰§è¡Œ


æ•°æ®æ¢å¤çš„æ ¸å¿ƒæ˜¯å°†å¤‡ä»½æ–‡ä»¶æ­£ç¡®è§£å‹åˆ°æ•°æ®ç›®å½•ã€‚

**æ ‡å‡†æ¢å¤æµç¨‹**ï¼š

```bash
#!/bin/bash
# MySQLæ•°æ®æ¢å¤è„šæœ¬

restore_mysql_data() {
    local backup_file="$1"
    local mysql_data_dir="${2:-/var/lib/mysql}"
    
    echo "=== å¼€å§‹æ•°æ®æ¢å¤ ==="
    
    # åˆ›å»ºæ•°æ®ç›®å½•
    mkdir -p "$(dirname $mysql_data_dir)"
    
    # æ ¹æ®å¤‡ä»½æ–‡ä»¶ç±»å‹è¿›è¡Œæ¢å¤
    if [[ "$backup_file" == *.tar.gz ]]; then
        echo "è§£å‹tar.gzå¤‡ä»½æ–‡ä»¶..."
        tar -xzf "$backup_file" -C "$(dirname $mysql_data_dir)"
    elif [[ "$backup_file" == *.tar ]]; then
        echo "è§£å‹tarå¤‡ä»½æ–‡ä»¶..."
        tar -xf "$backup_file" -C "$(dirname $mysql_data_dir)"
    else
        echo "é”™è¯¯: ä¸æ”¯æŒçš„å¤‡ä»½æ–‡ä»¶æ ¼å¼"
        return 1
    fi
    
    # ä¿®æ­£æ–‡ä»¶æƒé™
    chown -R mysql:mysql "$mysql_data_dir"
    chmod -R 750 "$mysql_data_dir"
    
    echo "æ•°æ®æ¢å¤å®Œæˆ"
    return 0
}
```

### 7.3 æ¢å¤åéªŒè¯


æ¢å¤å®Œæˆåï¼Œå¿…é¡»è¿›è¡Œå…¨é¢éªŒè¯ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚

**æ¢å¤éªŒè¯è„šæœ¬**ï¼š

```bash
#!/bin/bash
# æ¢å¤åéªŒè¯è„šæœ¬

verify_restore() {
    echo "=== æ¢å¤åéªŒè¯ ==="
    
    # 1. å¯åŠ¨MySQLæœåŠ¡
    echo "å¯åŠ¨MySQLæœåŠ¡..."
    if ! systemctl start mysql; then
        echo "é”™è¯¯: MySQLå¯åŠ¨å¤±è´¥"
        return 1
    fi
    
    # ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨
    sleep 10
    
    # 2. æ£€æŸ¥MySQLè¿›ç¨‹
    if ! pgrep mysqld > /dev/null; then
        echo "é”™è¯¯: MySQLè¿›ç¨‹æœªè¿è¡Œ"
        return 1
    fi
    
    # 3. æµ‹è¯•æ•°æ®åº“è¿æ¥
    if ! mysql -u root -p -e "SELECT 1;" > /dev/null 2>&1; then
        echo "é”™è¯¯: æ— æ³•è¿æ¥æ•°æ®åº“"
        return 1
    fi
    
    # 4. æ£€æŸ¥æ•°æ®åº“åˆ—è¡¨
    echo "æ£€æŸ¥æ•°æ®åº“åˆ—è¡¨:"
    mysql -u root -p -e "SHOW DATABASES;"
    
    # 5. æ£€æŸ¥è¡¨æ•°é‡
    echo "æ£€æŸ¥ä¸»è¦æ•°æ®åº“çš„è¡¨æ•°é‡:"
    mysql -u root -p -e "
        SELECT 
            SCHEMA_NAME as 'æ•°æ®åº“',
            COUNT(*) as 'è¡¨æ•°é‡'
        FROM information_schema.TABLES 
        WHERE SCHEMA_NAME NOT IN ('mysql', 'performance_schema', 'sys', 'information_schema')
        GROUP BY SCHEMA_NAME;
    "
    
    # 6. æ£€æŸ¥InnoDBçŠ¶æ€
    echo "æ£€æŸ¥InnoDBå¼•æ“çŠ¶æ€:"
    mysql -u root -p -e "SHOW ENGINE INNODB STATUS\G" | grep -A 5 "BACKGROUND THREAD"
    
    echo "æ¢å¤éªŒè¯å®Œæˆ"
    return 0
}
```

---

## 8. ğŸ“Š ä¸šåŠ¡å½±å“è¯„ä¼°ä¸ä¼˜åŒ–


### 8.1 åœæœºæ—¶é—´åˆ†æ


å‡†ç¡®è¯„ä¼°å†·å¤‡ä»½å¯¹ä¸šåŠ¡çš„å½±å“ï¼Œæ˜¯åˆ¶å®šå¤‡ä»½ç­–ç•¥çš„é‡è¦ä¾æ®ã€‚

**åœæœºæ—¶é—´æ„æˆåˆ†æ**ï¼š

```
å†·å¤‡ä»½åœæœºæ—¶é—´ç»„æˆï¼š

æ•°æ®åº“å…³é—­æ—¶é—´ï¼š2-5åˆ†é’Ÿ
â”œâ”€â”€ ç­‰å¾…äº‹åŠ¡å®Œæˆï¼š1-3åˆ†é’Ÿ
â”œâ”€â”€ åˆ·æ–°ç¼“å†²åŒºï¼š30ç§’-1åˆ†é’Ÿ  
â””â”€â”€ æœåŠ¡åœæ­¢ï¼š30ç§’

æ•°æ®å¤‡ä»½æ—¶é—´ï¼šæ ¹æ®æ•°æ®é‡
â”œâ”€â”€ å°å‹æ•°æ®åº“(< 10GB)ï¼š5-15åˆ†é’Ÿ
â”œâ”€â”€ ä¸­å‹æ•°æ®åº“(10-100GB)ï¼š15-60åˆ†é’Ÿ
â””â”€â”€ å¤§å‹æ•°æ®åº“(> 100GB)ï¼š1-4å°æ—¶

æ•°æ®åº“å¯åŠ¨æ—¶é—´ï¼š2-10åˆ†é’Ÿ
â”œâ”€â”€ InnoDBæ¢å¤ï¼š1-8åˆ†é’Ÿï¼ˆæ ¹æ®æ—¥å¿—é‡ï¼‰
â”œâ”€â”€ ç¼“å­˜é¢„çƒ­ï¼š1-2åˆ†é’Ÿ
â””â”€â”€ æœåŠ¡å°±ç»ªï¼š30ç§’
```

**åœæœºæ—¶é—´è®¡ç®—è„šæœ¬**ï¼š

```bash
#!/bin/bash
# åœæœºæ—¶é—´è¯„ä¼°è„šæœ¬

estimate_downtime() {
    local data_size_gb="$1"
    
    echo "=== åœæœºæ—¶é—´è¯„ä¼° ==="
    
    # åŸºç¡€åœæœºæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
    local shutdown_time=3
    local startup_time=5
    
    # æ ¹æ®æ•°æ®é‡ä¼°ç®—å¤‡ä»½æ—¶é—´ï¼ˆå‡è®¾å¤‡ä»½é€Ÿåº¦100MB/sï¼‰
    local backup_time_minutes=$((data_size_gb * 1024 / 100 / 60))
    
    local total_downtime=$((shutdown_time + backup_time_minutes + startup_time))
    
    cat << EOF
æ•°æ®é‡: ${data_size_gb}GB
é¢„ä¼°åœæœºæ—¶é—´:
- æ•°æ®åº“å…³é—­: ${shutdown_time}åˆ†é’Ÿ
- æ•°æ®å¤‡ä»½: ${backup_time_minutes}åˆ†é’Ÿ  
- æ•°æ®åº“å¯åŠ¨: ${startup_time}åˆ†é’Ÿ
- æ€»è®¡åœæœºæ—¶é—´: ${total_downtime}åˆ†é’Ÿ

ä¸šåŠ¡å½±å“è¯„ä¼°:
EOF
    
    if [ $total_downtime -le 15 ]; then
        echo "- å½±å“ç­‰çº§: ä½ï¼ˆå»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œï¼‰"
    elif [ $total_downtime -le 60 ]; then
        echo "- å½±å“ç­‰çº§: ä¸­ï¼ˆéœ€è¦ä¸šåŠ¡æ–¹é…åˆå®‰æ’ç»´æŠ¤çª—å£ï¼‰"
    else
        echo "- å½±å“ç­‰çº§: é«˜ï¼ˆå»ºè®®è€ƒè™‘çƒ­å¤‡ä»½æ–¹æ¡ˆï¼‰"
    fi
}
```

### 8.2 ä¸šåŠ¡è¿ç»­æ€§ç­–ç•¥


é’ˆå¯¹ä¸åŒä¸šåŠ¡åœºæ™¯ï¼Œåˆ¶å®šç›¸åº”çš„è¿ç»­æ€§ä¿éšœç­–ç•¥ã€‚

**åˆ†å±‚ä¸šåŠ¡å¤„ç†ç­–ç•¥**ï¼š

| ä¸šåŠ¡ç±»å‹ | **å¯æ¥å—åœæœºæ—¶é—´** | **æ¨èç­–ç•¥** | **å¤‡ä»½é¢‘ç‡** |
|---------|-------------------|-------------|-------------|
| `æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ` | `< 5åˆ†é’Ÿ` | `ä¸»ä»åˆ‡æ¢ + çƒ­å¤‡ä»½` | `å®æ—¶` |
| `ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿ` | `15-30åˆ†é’Ÿ` | `ç»´æŠ¤çª—å£ + å†·å¤‡ä»½` | `æ¯æ—¥` |
| `æŠ¥è¡¨åˆ†æç³»ç»Ÿ` | `1-2å°æ—¶` | `è®¡åˆ’åœæœº + å†·å¤‡ä»½` | `æ¯å‘¨` |
| `å¼€å‘æµ‹è¯•ç¯å¢ƒ` | `ä¸é™åˆ¶` | `éšæ—¶å†·å¤‡ä»½` | `æŒ‰éœ€` |

### 8.3 å¿«é€Ÿå†·å¤‡ä»½ä¼˜åŒ–æŠ€æœ¯


é€šè¿‡æŠ€æœ¯ä¼˜åŒ–æ‰‹æ®µï¼Œæœ€å¤§ç¨‹åº¦ç¼©çŸ­å†·å¤‡ä»½çš„åœæœºæ—¶é—´ã€‚

**å¹¶è¡Œå¤‡ä»½ç­–ç•¥**ï¼š

```bash
#!/bin/bash
# å¹¶è¡Œå¿«é€Ÿå¤‡ä»½è„šæœ¬

parallel_backup() {
    local mysql_data_dir="$1"
    local backup_dir="$2"
    local parallel_jobs=4
    
    echo "=== æ‰§è¡Œå¹¶è¡Œå¤‡ä»½ ==="
    
    # è·å–æ•°æ®åº“åˆ—è¡¨ï¼ˆæ’é™¤ç³»ç»Ÿæ•°æ®åº“ï¼‰
    local databases=($(find "$mysql_data_dir" -maxdepth 1 -type d -name "*" ! -name "mysql" ! -name "performance_schema" ! -name "sys" ! -name "information_schema" -printf "%f\n"))
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    mkdir -p "$backup_dir"
    
    # å¹¶è¡Œå¤‡ä»½å„ä¸ªæ•°æ®åº“
    echo "å¼€å§‹å¹¶è¡Œå¤‡ä»½ ${#databases[@]} ä¸ªæ•°æ®åº“..."
    
    for db in "${databases[@]}"; do
        (
            echo "å¤‡ä»½æ•°æ®åº“: $db"
            tar -czf "$backup_dir/${db}_$(date +%Y%m%d_%H%M%S).tar.gz" -C "$mysql_data_dir" "$db"
            echo "å®Œæˆå¤‡ä»½: $db"
        ) &
        
        # æ§åˆ¶å¹¶è¡Œä»»åŠ¡æ•°é‡
        (($(jobs -r | wc -l) >= parallel_jobs)) && wait
    done
    
    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    wait
    
    # å¤‡ä»½ç³»ç»Ÿæ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶
    echo "å¤‡ä»½ç³»ç»Ÿæ–‡ä»¶..."
    tar -czf "$backup_dir/system_files_$(date +%Y%m%d_%H%M%S).tar.gz" -C "$mysql_data_dir" mysql ib_logfile* ibdata* mysql-bin.*
    
    echo "å¹¶è¡Œå¤‡ä»½å®Œæˆ"
}
```

**æ–‡ä»¶ç³»ç»Ÿå¿«ç…§æŠ€æœ¯**ï¼š

```bash
#!/bin/bash
# LVMå¿«ç…§å¤‡ä»½è„šæœ¬ï¼ˆé€‚ç”¨äºæ”¯æŒLVMçš„ç³»ç»Ÿï¼‰

lvm_snapshot_backup() {
    local lv_path="/dev/vg_mysql/lv_mysql"
    local snapshot_name="mysql_snap_$(date +%Y%m%d_%H%M%S)"
    local snapshot_size="5G"
    local backup_dir="/backup/mysql"
    
    echo "=== LVMå¿«ç…§å¤‡ä»½ ==="
    
    # 1. åˆ·æ–°æ•°æ®åº“ç¼“å†²åŒº
    mysql -u root -p -e "FLUSH TABLES WITH READ LOCK;"
    mysql -u root -p -e "FLUSH LOGS;"
    
    # 2. åˆ›å»ºLVMå¿«ç…§
    if lvcreate -L "$snapshot_size" -s -n "$snapshot_name" "$lv_path"; then
        echo "å¿«ç…§åˆ›å»ºæˆåŠŸ: $snapshot_name"
        
        # 3. è§£é”æ•°æ®åº“ï¼ˆå¿«ç…§å·²åˆ›å»ºï¼Œå¯ä»¥ç»§ç»­æœåŠ¡ï¼‰
        mysql -u root -p -e "UNLOCK TABLES;"
        
        # 4. æŒ‚è½½å¿«ç…§å¹¶å¤‡ä»½
        local mount_point="/mnt/$snapshot_name"
        mkdir -p "$mount_point"
        
        if mount "/dev/vg_mysql/$snapshot_name" "$mount_point"; then
            # å¤‡ä»½å¿«ç…§æ•°æ®
            tar -czf "$backup_dir/mysql_snapshot_$(date +%Y%m%d_%H%M%S).tar.gz" -C "$mount_point" .
            
            # å¸è½½å¹¶åˆ é™¤å¿«ç…§
            umount "$mount_point"
            lvremove -f "/dev/vg_mysql/$snapshot_name"
            
            echo "å¿«ç…§å¤‡ä»½å®Œæˆ"
        else
            echo "é”™è¯¯: æ— æ³•æŒ‚è½½å¿«ç…§"
            return 1
        fi
    else
        mysql -u root -p -e "UNLOCK TABLES;"
        echo "é”™è¯¯: å¿«ç…§åˆ›å»ºå¤±è´¥"
        return 1
    fi
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å†·å¤‡ä»½æœ¬è´¨ï¼šæ•°æ®åº“å®Œå…¨åœæœºçŠ¶æ€ä¸‹çš„ç‰©ç†æ–‡ä»¶å¤‡ä»½
ğŸ”¸ ä¸€è‡´æ€§ä¿è¯ï¼šé€šè¿‡åœæœºç¡®ä¿æ‰€æœ‰æ•°æ®å¤„äºé™æ­¢çŠ¶æ€
ğŸ”¸ å¤‡ä»½æ–¹æ³•ï¼šæ–‡ä»¶æ‹·è´ã€tarå½’æ¡£ã€å‹ç¼©å­˜å‚¨
ğŸ”¸ è‡ªåŠ¨åŒ–æµç¨‹ï¼šåœæœºâ†’å¤‡ä»½â†’å¯åŠ¨â†’éªŒè¯â†’æ¸…ç†
ğŸ”¸ æ¢å¤æµç¨‹ï¼šå‡†å¤‡â†’è§£å‹â†’æƒé™â†’å¯åŠ¨â†’éªŒè¯
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å†·å¤‡ä»½çš„ä¼˜åŠ£åŠ¿**
```
ä¼˜åŠ¿ï¼š
âœ… æ•°æ®ä¸€è‡´æ€§æœ€ä½³
âœ… å¤‡ä»½é€Ÿåº¦æœ€å¿«
âœ… æ¢å¤è¿‡ç¨‹ç®€å•
âœ… é€‚åˆä»»ä½•å­˜å‚¨å¼•æ“

åŠ£åŠ¿ï¼š
âŒ éœ€è¦å®Œå…¨åœæœº
âŒ ä¸šåŠ¡è¿ç»­æ€§å½±å“å¤§
âŒ ä¸é€‚åˆ7Ã—24å°æ—¶ç³»ç»Ÿ
âŒ å¤‡ä»½é¢‘ç‡å—é™
```

**ğŸ”¹ é€‚ç”¨åœºæ™¯åˆ¤æ–­**
```
æœ€é€‚åˆå†·å¤‡ä»½çš„åœºæ™¯ï¼š
ğŸŒ™ æœ‰å›ºå®šç»´æŠ¤çª—å£çš„ç³»ç»Ÿ
ğŸ¢ éæ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿ
ğŸ“Š æ•°æ®ä»“åº“å’Œåˆ†æç³»ç»Ÿ
ğŸ”§ å¼€å‘æµ‹è¯•ç¯å¢ƒ

ä¸é€‚åˆå†·å¤‡ä»½çš„åœºæ™¯ï¼š
ğŸ”¥ æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ
âš¡ é«˜å¯ç”¨æ€§è¦æ±‚çš„ç³»ç»Ÿ
ğŸŒ äº’è”ç½‘æœåŠ¡
ğŸ“± ç§»åŠ¨åº”ç”¨åç«¯
```

**ğŸ”¹ æŠ€æœ¯å®ç°è¦ç‚¹**
```
åœæœºå¤‡ä»½æµç¨‹ï¼š
æ£€æŸ¥çŠ¶æ€ â†’ åœæ­¢å†™å…¥ â†’ åˆ·æ–°ç¼“å­˜ â†’ åœæ­¢æœåŠ¡ â†’ æ–‡ä»¶å¤‡ä»½

ä¸€è‡´æ€§ä¿è¯ï¼š
åœæœºçŠ¶æ€ + ç¼“å­˜åˆ·æ–° + äº‹åŠ¡å®Œæˆ = å®Œå…¨ä¸€è‡´æ€§

è‡ªåŠ¨åŒ–è¦ç´ ï¼š
è„šæœ¬åŒ– + ç›‘æ§ + æ—¥å¿— + éªŒè¯ + æ¸…ç†
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“‹ å®æ–½å»ºè®®**
- **åˆ¶å®šè®¡åˆ’**ï¼šç¡®å®šå¤‡ä»½çª—å£ï¼Œé€šçŸ¥ç›¸å…³äººå‘˜
- **æµ‹è¯•éªŒè¯**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯å¤‡ä»½æ¢å¤æµç¨‹
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹å®Œå–„çš„å¤‡ä»½ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦
- **æ–‡æ¡£è®°å½•**ï¼šè¯¦ç»†è®°å½•å¤‡ä»½é…ç½®å’Œæ“ä½œæµç¨‹

**âš ï¸ æ³¨æ„äº‹é¡¹**
- **ç©ºé—´é¢„ç•™**ï¼šç¡®ä¿å¤‡ä»½å­˜å‚¨æœ‰è¶³å¤Ÿç©ºé—´ï¼ˆè‡³å°‘2å€æ•°æ®é‡ï¼‰
- **æƒé™ç®¡ç†**ï¼šå¤‡ä»½æ–‡ä»¶çš„å®‰å…¨æ€§å’Œè®¿é—®æƒé™æ§åˆ¶
- **å®šæœŸæ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œæ¢å¤æ¼”ç»ƒï¼ŒéªŒè¯å¤‡ä»½å¯ç”¨æ€§
- **ç‰ˆæœ¬å…¼å®¹**ï¼šæ³¨æ„MySQLç‰ˆæœ¬é—´çš„å…¼å®¹æ€§é—®é¢˜

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–**
- **å¹¶è¡Œå¤„ç†**ï¼šå¤§æ•°æ®é‡æ—¶ä½¿ç”¨å¹¶è¡Œå¤‡ä»½æŠ€æœ¯
- **å‹ç¼©ç®—æ³•**ï¼šæ ¹æ®å­˜å‚¨å’Œæ€§èƒ½éœ€æ±‚é€‰æ‹©åˆé€‚çš„å‹ç¼©æ–¹å¼
- **ç½‘ç»œä¼ è¾“**ï¼šå¼‚åœ°å¤‡ä»½æ—¶è€ƒè™‘ç½‘ç»œå¸¦å®½å’Œä¼ è¾“æ—¶é—´
- **å­˜å‚¨ä¼˜åŒ–**ï¼šä½¿ç”¨SSDå­˜å‚¨æé«˜å¤‡ä»½é€Ÿåº¦

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ğŸ“ **å†·å¤‡ä»½è¦ç‚¹**  
> åœæœºå¤‡ä»½æ•°æ®é™ï¼Œæ–‡ä»¶æ‹·è´æœ€ç›´æ¥  
> ä¸€è‡´æ€§å¥½æ¢å¤å¿«ï¼Œä¸šåŠ¡åœæœºæ˜¯ä»£ä»·  
> è‡ªåŠ¨è„šæœ¬ä¿å¯é ï¼Œç›‘æ§éªŒè¯ä¸å¯ç¼º