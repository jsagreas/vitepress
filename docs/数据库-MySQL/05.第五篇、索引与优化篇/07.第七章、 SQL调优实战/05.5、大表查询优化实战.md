---
title: 5ã€å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–æ¦‚è¿°](#1-å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–æ¦‚è¿°)
2. [åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯](#2-åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯)
3. [å¤§è¡¨æŸ¥è¯¢åˆ†ç‰‡ç­–ç•¥](#3-å¤§è¡¨æŸ¥è¯¢åˆ†ç‰‡ç­–ç•¥)
4. [æµå¼æŸ¥è¯¢å¤„ç†æŠ€æœ¯](#4-æµå¼æŸ¥è¯¢å¤„ç†æŠ€æœ¯)
5. [å¢é‡æŸ¥è¯¢ä¼˜åŒ–](#5-å¢é‡æŸ¥è¯¢ä¼˜åŒ–)
6. [ç¼“å­˜ä¸é¢„å¤„ç†ç­–ç•¥](#6-ç¼“å­˜ä¸é¢„å¤„ç†ç­–ç•¥)
7. [èµ„æºæ§åˆ¶ä¸ç›‘æ§](#7-èµ„æºæ§åˆ¶ä¸ç›‘æ§)
8. [å¤§è¡¨ä¼˜åŒ–å®æˆ˜æ¡ˆä¾‹](#8-å¤§è¡¨ä¼˜åŒ–å®æˆ˜æ¡ˆä¾‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—‚ï¸ å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¤§è¡¨æŸ¥è¯¢é—®é¢˜


**ğŸ”¸ å¤§è¡¨å®šä¹‰**
```
å¤§è¡¨çš„åˆ¤æ–­æ ‡å‡†ï¼š
â€¢ æ•°æ®é‡ï¼šé€šå¸¸æŒ‡ç™¾ä¸‡çº§ä»¥ä¸Šçš„è®°å½•
â€¢ å­˜å‚¨å¤§å°ï¼šå•è¡¨è¶…è¿‡å‡ GBçš„æ•°æ®
â€¢ æŸ¥è¯¢è€—æ—¶ï¼šç®€å•æŸ¥è¯¢è¶…è¿‡å‡ ç§’é’Ÿ
â€¢ èµ„æºæ¶ˆè€—ï¼šæŸ¥è¯¢å ç”¨å¤§é‡CPU/å†…å­˜/IO
```

**ğŸ’¡ å¤§è¡¨æŸ¥è¯¢çš„å…¸å‹é—®é¢˜**
```
æ€§èƒ½é—®é¢˜ï¼š
â€¢ æŸ¥è¯¢å“åº”æ—¶é—´é•¿ï¼ˆç”¨æˆ·ä½“éªŒå·®ï¼‰
â€¢ æ•°æ®åº“èµ„æºæ¶ˆè€—å¤§ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜IOï¼‰
â€¢ å¹¶å‘æŸ¥è¯¢æ—¶ç³»ç»Ÿè´Ÿè½½è¿‡é«˜
â€¢ æ·±åˆ†é¡µæŸ¥è¯¢æ€§èƒ½æ€¥å‰§ä¸‹é™

ä¸šåŠ¡å½±å“ï¼š
â€¢ ç”¨æˆ·ç­‰å¾…æ—¶é—´è¿‡é•¿
â€¢ ç³»ç»Ÿæ•´ä½“å“åº”å˜æ…¢
â€¢ é«˜å³°æœŸå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ
â€¢ å½±å“å…¶ä»–åº”ç”¨çš„æ­£å¸¸ä½¿ç”¨
```

**ğŸ¯ å¸¸è§çš„å¤§è¡¨åœºæ™¯**
```
è®¢å•è¡¨ï¼š
â€¢ ç”µå•†å¹³å°çš„å†å²è®¢å•
â€¢ é‡‘èç³»ç»Ÿçš„äº¤æ˜“è®°å½•
â€¢ ç‰©æµç³»ç»Ÿçš„è¿å•ä¿¡æ¯

æ—¥å¿—è¡¨ï¼š
â€¢ åº”ç”¨è®¿é—®æ—¥å¿—
â€¢ ç³»ç»Ÿæ“ä½œæ—¥å¿—
â€¢ é”™è¯¯å¼‚å¸¸æ—¥å¿—

ç”¨æˆ·è¡Œä¸ºè¡¨ï¼š
â€¢ ç”¨æˆ·æµè§ˆè®°å½•
â€¢ ç‚¹å‡»ç»Ÿè®¡æ•°æ®
â€¢ æœç´¢å†å²è®°å½•
```

### 1.2 å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–çš„æ ¸å¿ƒæ€è·¯


**ğŸª ä¼˜åŒ–ç­–ç•¥æ€»è§ˆ**
```
ç´¢å¼•ä¼˜åŒ–å±‚é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆç†è®¾è®¡ç´¢å¼•     â”‚ â† æœ€åŸºç¡€ä¹Ÿæœ€é‡è¦çš„ä¼˜åŒ–
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¦†ç›–ç´¢å¼•ä½¿ç”¨     â”‚ â† é¿å…å›è¡¨æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤åˆç´¢å¼•è®¾è®¡     â”‚ â† æ”¯æŒå¤æ‚æŸ¥è¯¢æ¡ä»¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æŸ¥è¯¢å±‚é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQLè¯­å¥ä¼˜åŒ–     â”‚ â† é¿å…ä½æ•ˆçš„æŸ¥è¯¢å†™æ³•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ†é¡µç­–ç•¥ä¼˜åŒ–     â”‚ â† è§£å†³æ·±åˆ†é¡µé—®é¢˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–     â”‚ â† åˆ©ç”¨ç´¢å¼•ï¼Œå‡å°‘æ‰«æ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¶æ„å±‚é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®åˆ†ç‰‡/åˆ†åŒº   â”‚ â† åŒ–æ•´ä¸ºé›¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯»å†™åˆ†ç¦»        â”‚ â† åˆ†æ•£æŸ¥è¯¢å‹åŠ›
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¼“å­˜ç­–ç•¥        â”‚ â† å‡å°‘æ•°æ®åº“è®¿é—®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’­ ä¼˜åŒ–æ€ç»´**
> **æ ¸å¿ƒç†å¿µ**ï¼šèƒ½ä¸æŸ¥å°±ä¸æŸ¥ï¼Œèƒ½å°‘æŸ¥å°±å°‘æŸ¥ï¼Œèƒ½å¿«æŸ¥å°±å¿«æŸ¥
> 
> - **èƒ½ä¸æŸ¥**ï¼šé€šè¿‡ç¼“å­˜é¿å…é‡å¤æŸ¥è¯¢
> - **èƒ½å°‘æŸ¥**ï¼šé€šè¿‡åˆ†é¡µã€æ¡ä»¶è¿‡æ»¤å‡å°‘æ•°æ®é‡
> - **èƒ½å¿«æŸ¥**ï¼šé€šè¿‡ç´¢å¼•ã€åˆ†ç‰‡æé«˜æŸ¥è¯¢æ•ˆç‡

---

## 2. ğŸ“„ åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯


### 2.1 ä¼ ç»Ÿåˆ†é¡µçš„æ€§èƒ½é—®é¢˜


**âŒ OFFSETåˆ†é¡µçš„è‡´å‘½ç¼ºé™·**

ä¼ ç»Ÿçš„åˆ†é¡µæŸ¥è¯¢å†™æ³•ï¼š
```sql
-- æŸ¥è¯¢ç¬¬1000é¡µï¼Œæ¯é¡µ20æ¡è®°å½•
SELECT * FROM orders 
ORDER BY create_time DESC 
LIMIT 20 OFFSET 19980;
```

**ğŸ” é—®é¢˜åˆ†æ**
```
OFFSETå·¥ä½œåŸç†ï¼š
1. æ•°æ®åº“éœ€è¦å…ˆæ‰«æå‰19980æ¡è®°å½•
2. ç„¶åè·³è¿‡è¿™äº›è®°å½•
3. æœ€åè¿”å›æ¥ä¸‹æ¥çš„20æ¡è®°å½•

æ€§èƒ½é—®é¢˜ï¼š
é¡µç è¶Šå¤§ â†’ OFFSETè¶Šå¤§ â†’ æ‰«æè®°å½•è¶Šå¤š â†’ å“åº”æ—¶é—´è¶Šé•¿

å®é™…æµ‹è¯•ç»“æœï¼š
ç¬¬1é¡µï¼ˆOFFSET 0ï¼‰ï¼š     10ms
ç¬¬100é¡µï¼ˆOFFSET 2000ï¼‰ï¼š 50ms  
ç¬¬1000é¡µï¼ˆOFFSET 20000ï¼‰ï¼š500ms
ç¬¬10000é¡µï¼ˆOFFSET 200000ï¼‰ï¼š5000ms
```

**ğŸ“ˆ æ€§èƒ½ä¸‹é™æ›²çº¿**
```
å“åº”æ—¶é—´
   ^
   |     .,''''
   |   ,'
   |  /
   | /
   |/________________> é¡µç æ•°é‡
   0  1k  10k  100k

ç‰¹ç‚¹ï¼šéšç€é¡µç å¢å¤§ï¼Œæ€§èƒ½æ€¥å‰§ä¸‹é™
```

### 2.2 æ¸¸æ ‡åˆ†é¡µæŠ€æœ¯ï¼ˆæ¨èæ–¹æ¡ˆï¼‰


**âœ… åŸºäºä¸»é”®çš„æ¸¸æ ‡åˆ†é¡µ**

**ğŸ”¸ æ ¸å¿ƒæ€æƒ³**ï¼šç”¨ä¸Šä¸€é¡µçš„æœ€åä¸€æ¡è®°å½•ä½œä¸ºä¸‹ä¸€é¡µæŸ¥è¯¢çš„èµ·ç‚¹

```sql
-- ç¬¬ä¸€é¡µæŸ¥è¯¢
SELECT id, user_id, amount, create_time 
FROM orders 
WHERE status = 'completed'
ORDER BY id DESC 
LIMIT 20;

-- å‡è®¾è¿”å›çš„æœ€åä¸€æ¡è®°å½•id=98765

-- ç¬¬äºŒé¡µæŸ¥è¯¢
SELECT id, user_id, amount, create_time 
FROM orders 
WHERE status = 'completed' 
  AND id < 98765  -- å…³é”®ï¼šä½¿ç”¨ä¸Šä¸€é¡µæœ€åçš„id
ORDER BY id DESC 
LIMIT 20;
```

**ğŸ’¡ æ¸¸æ ‡åˆ†é¡µçš„ä¼˜åŠ¿**
```
æ€§èƒ½ç¨³å®šï¼š
â€¢ ä¸ç®¡æŸ¥è¯¢ç¬¬å‡ é¡µï¼Œæ€§èƒ½éƒ½å¾ˆç¨³å®š
â€¢ æŸ¥è¯¢æ¡ä»¶å§‹ç»ˆèƒ½ç”¨åˆ°ä¸»é”®ç´¢å¼•
â€¢ æ‰«æçš„è®°å½•æ•°é‡å›ºå®š

å®é™…æ•ˆæœï¼š
ç¬¬1é¡µï¼š10ms
ç¬¬1000é¡µï¼š12ms  
ç¬¬10000é¡µï¼š15ms
ç¬¬100000é¡µï¼š18ms

æ€§èƒ½æ›²çº¿ï¼šå‡ ä¹æ˜¯ä¸€æ¡æ°´å¹³çº¿ï¼
```

**âš ï¸ æ¸¸æ ‡åˆ†é¡µçš„é™åˆ¶**
```
ä½¿ç”¨åœºæ™¯é™åˆ¶ï¼š
â€¢ å¿…é¡»æœ‰å”¯ä¸€æ’åºå­—æ®µï¼ˆå¦‚ä¸»é”®idï¼‰
â€¢ ä¸æ”¯æŒè·³é¡µæ“ä½œï¼ˆåªèƒ½é¡ºåºç¿»é¡µï¼‰
â€¢ æ’åºå­—æ®µä¸èƒ½é‡å¤

è§£å†³æ–¹æ¡ˆï¼š
â€¢ ç»„åˆå¤šä¸ªå­—æ®µä¿è¯å”¯ä¸€æ€§
â€¢ ä¸ºç‰¹å®šä¸šåŠ¡åœºæ™¯è®¾è®¡ä¸“é—¨çš„åˆ†é¡µæ–¹å¼
```

### 2.3 æ·±åˆ†é¡µä¼˜åŒ–æŠ€æœ¯


**ğŸ”§ å»¶è¿Ÿå…³è”æŠ€æœ¯**

ä¼ ç»ŸæŸ¥è¯¢é—®é¢˜ï¼šéœ€è¦å›è¡¨è·å–æ‰€æœ‰å­—æ®µ
```sql
-- ä½æ•ˆçš„æ·±åˆ†é¡µæŸ¥è¯¢
SELECT id, user_id, amount, create_time, description 
FROM orders 
ORDER BY create_time DESC 
LIMIT 20 OFFSET 100000;
```

ä¼˜åŒ–åçš„å»¶è¿Ÿå…³è”ï¼š
```sql
-- ç¬¬ä¸€æ­¥ï¼šåªæŸ¥è¯¢ä¸»é”®ï¼Œåˆ©ç”¨è¦†ç›–ç´¢å¼•
SELECT id FROM orders 
ORDER BY create_time DESC 
LIMIT 20 OFFSET 100000;

-- ç¬¬äºŒæ­¥ï¼šæ ¹æ®ä¸»é”®æ‰¹é‡æŸ¥è¯¢è¯¦ç»†ä¿¡æ¯
SELECT id, user_id, amount, create_time, description 
FROM orders 
WHERE id IN (12345, 12346, 12347, ...);
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”**
```
æµ‹è¯•æ¡ä»¶ï¼š1000ä¸‡è®¢å•è®°å½•ï¼ŒæŸ¥è¯¢ç¬¬5000é¡µ

ä¼ ç»Ÿæ–¹æ³•ï¼š
â€¢ æŸ¥è¯¢æ—¶é—´ï¼š8.5ç§’
â€¢ æ‰«æè®°å½•ï¼š100ä¸‡æ¡
â€¢ å›è¡¨æ¬¡æ•°ï¼š100ä¸‡æ¬¡

å»¶è¿Ÿå…³è”ï¼š
â€¢ ç¬¬ä¸€æ­¥æŸ¥è¯¢ï¼š2.1ç§’
â€¢ ç¬¬äºŒæ­¥æŸ¥è¯¢ï¼š0.02ç§’
â€¢ æ€»æ—¶é—´ï¼š2.12ç§’
â€¢ æ€§èƒ½æå‡ï¼š4å€
```

### 2.4 åˆ†é¡µç¼“å­˜ç­–ç•¥


**ğŸ¯ çƒ­ç‚¹é¡µé¢ç¼“å­˜**

å®é™…åº”ç”¨ä¸­ï¼Œç”¨æˆ·æŸ¥è¯¢æœ‰æ˜æ˜¾çš„çƒ­ç‚¹è§„å¾‹ï¼š
```
ç”¨æˆ·è¡Œä¸ºåˆ†æï¼š
â€¢ 70%çš„ç”¨æˆ·åªæŸ¥çœ‹å‰3é¡µ
â€¢ 90%çš„ç”¨æˆ·ä¸ä¼šè¶…è¿‡å‰10é¡µ
â€¢ 99%çš„ç”¨æˆ·ä¸ä¼šè¶…è¿‡å‰100é¡µ

ç¼“å­˜ç­–ç•¥è®¾è®¡ï¼š
å‰10é¡µï¼šRedisç¼“å­˜ï¼ŒTTL=300ç§’
å‰100é¡µï¼šæœ¬åœ°ç¼“å­˜ï¼ŒTTL=600ç§’
100é¡µä»¥åï¼šå®æ—¶æŸ¥è¯¢ï¼Œä½¿ç”¨æ¸¸æ ‡åˆ†é¡µ
```

**ğŸ’» ç¼“å­˜å®ç°ç¤ºä¾‹**
```java
@Service
public class OrderPageService {
    
    @Autowired
    private RedisTemplate<String, Object> redis;
    
    public PageResult<Order> getOrderPage(int pageNo, int pageSize) {
        String cacheKey = "order_page:" + pageNo + ":" + pageSize;
        
        // å‰10é¡µä½¿ç”¨Redisç¼“å­˜
        if (pageNo <= 10) {
            PageResult<Order> cached = redis.opsForValue().get(cacheKey);
            if (cached != null) {
                return cached;
            }
        }
        
        // ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µæŸ¥è¯¢æ•°æ®åº“
        PageResult<Order> result = queryWithCursor(pageNo, pageSize);
        
        // ç¼“å­˜çƒ­ç‚¹é¡µé¢
        if (pageNo <= 10) {
            redis.opsForValue().set(cacheKey, result, 300, TimeUnit.SECONDS);
        }
        
        return result;
    }
}
```

---

## 3. ğŸ”€ å¤§è¡¨æŸ¥è¯¢åˆ†ç‰‡ç­–ç•¥


### 3.1 æ°´å¹³åˆ†ç‰‡åŸºç¡€


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ•°æ®åˆ†ç‰‡**

æ•°æ®åˆ†ç‰‡å°±åƒæŠŠä¸€ä¸ªå·¨å¤§çš„å›¾ä¹¦é¦†åˆ†æˆå¤šä¸ªå°å›¾ä¹¦é¦†ï¼š
```
åŸå§‹å¤§è¡¨ï¼ˆ1000ä¸‡è®°å½•ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ orders (10,000,000 rows)    â”‚
â”‚ å ç”¨ç£ç›˜ï¼š50GB              â”‚
â”‚ å•è¡¨æŸ¥è¯¢ï¼šå¾ˆæ…¢              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ°´å¹³åˆ†ç‰‡åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ orders_2024 â”‚ â”‚ orders_2023 â”‚ â”‚ orders_2022 â”‚ â”‚ orders_2021 â”‚
â”‚ 300ä¸‡è®°å½•   â”‚ â”‚ 250ä¸‡è®°å½•   â”‚ â”‚ 200ä¸‡è®°å½•   â”‚ â”‚ 150ä¸‡è®°å½•   â”‚
â”‚ 15GB       â”‚ â”‚ 12GB       â”‚ â”‚ 10GB       â”‚ â”‚ 8GB        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ åˆ†ç‰‡çš„æ ¸å¿ƒå¥½å¤„**
```
æŸ¥è¯¢æ€§èƒ½æå‡ï¼š
â€¢ å•è¡¨æ•°æ®é‡å‡å°‘ â†’ ç´¢å¼•æ›´å° â†’ æŸ¥è¯¢æ›´å¿«
â€¢ å¹¶è¡ŒæŸ¥è¯¢ä¸åŒåˆ†ç‰‡ â†’ æ•´ä½“æ€§èƒ½æå‡
â€¢ ç»´æŠ¤æ“ä½œæ›´å¿«ï¼ˆé‡å»ºç´¢å¼•ã€å¤‡ä»½ç­‰ï¼‰

èµ„æºä½¿ç”¨ä¼˜åŒ–ï¼š
â€¢ å†…å­˜ä½¿ç”¨æ›´é«˜æ•ˆ
â€¢ ç£ç›˜IOåˆ†æ•£
â€¢ å¯ä»¥ä½¿ç”¨ä¸åŒçš„å­˜å‚¨ç­–ç•¥
```

### 3.2 åˆ†ç‰‡ç­–ç•¥è®¾è®¡


**ğŸ“… æŒ‰æ—¶é—´åˆ†ç‰‡ï¼ˆæœ€å¸¸ç”¨ï¼‰**

```sql
-- æŒ‰å¹´ä»½åˆ†ç‰‡
CREATE TABLE orders_2024 AS SELECT * FROM orders WHERE create_time >= '2024-01-01';
CREATE TABLE orders_2023 AS SELECT * FROM orders WHERE create_time >= '2023-01-01' AND create_time < '2024-01-01';

-- æŒ‰æœˆä»½åˆ†ç‰‡ï¼ˆæ•°æ®é‡ç‰¹åˆ«å¤§æ—¶ï¼‰
CREATE TABLE orders_202409 AS SELECT * FROM orders WHERE create_time >= '2024-09-01' AND create_time < '2024-10-01';
```

**ğŸ·ï¸ æŒ‰ä¸šåŠ¡å­—æ®µåˆ†ç‰‡**

```sql
-- æŒ‰ç”¨æˆ·IDåˆ†ç‰‡
CREATE TABLE orders_user_0 AS SELECT * FROM orders WHERE user_id % 4 = 0;
CREATE TABLE orders_user_1 AS SELECT * FROM orders WHERE user_id % 4 = 1;
CREATE TABLE orders_user_2 AS SELECT * FROM orders WHERE user_id % 4 = 2;
CREATE TABLE orders_user_3 AS SELECT * FROM orders WHERE user_id % 4 = 3;

-- æŒ‰åœ°åŒºåˆ†ç‰‡
CREATE TABLE orders_north AS SELECT * FROM orders WHERE region IN ('åŒ—äº¬', 'å¤©æ´¥', 'æ²³åŒ—');
CREATE TABLE orders_south AS SELECT * FROM orders WHERE region IN ('å¹¿ä¸œ', 'å¹¿è¥¿', 'æµ·å—');
```

### 3.3 åˆ†ç‰‡æŸ¥è¯¢è·¯ç”±


**ğŸ¯ æ™ºèƒ½è·¯ç”±ç­–ç•¥**

æ ¹æ®æŸ¥è¯¢æ¡ä»¶è‡ªåŠ¨é€‰æ‹©æŸ¥è¯¢å“ªä¸ªåˆ†ç‰‡ï¼š
```java
@Service
public class ShardingQueryService {
    
    public List<Order> queryOrders(Date startTime, Date endTime, Long userId) {
        List<String> targetTables = new ArrayList<>();
        
        // æ ¹æ®æ—¶é—´èŒƒå›´ç¡®å®šç›®æ ‡åˆ†ç‰‡
        if (startTime != null && endTime != null) {
            targetTables = getTablesByTimeRange(startTime, endTime);
        } else {
            targetTables = getAllTables(); // æŸ¥è¯¢æ‰€æœ‰åˆ†ç‰‡
        }
        
        List<Order> results = new ArrayList<>();
        
        // å¹¶è¡ŒæŸ¥è¯¢å„ä¸ªåˆ†ç‰‡
        for (String table : targetTables) {
            String sql = buildShardQuery(table, startTime, endTime, userId);
            List<Order> shardResult = jdbcTemplate.queryForList(sql, Order.class);
            results.addAll(shardResult);
        }
        
        // åˆå¹¶æ’åºç»“æœ
        return mergeAndSort(results);
    }
    
    private List<String> getTablesByTimeRange(Date start, Date end) {
        // æ™ºèƒ½è®¡ç®—éœ€è¦æŸ¥è¯¢å“ªäº›æ—¶é—´åˆ†ç‰‡
        List<String> tables = new ArrayList<>();
        Calendar cal = Calendar.getInstance();
        cal.setTime(start);
        
        while (cal.getTime().before(end)) {
            int year = cal.get(Calendar.YEAR);
            tables.add("orders_" + year);
            cal.add(Calendar.YEAR, 1);
        }
        
        return tables;
    }
}
```

### 3.4 åˆ†ç‰‡çš„æƒè¡¡ä¸é€‰æ‹©


**âš–ï¸ åˆ†ç‰‡ç­–ç•¥å¯¹æ¯”**

| åˆ†ç‰‡æ–¹å¼ | **ä¼˜åŠ¿** | **åŠ£åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|----------|----------|----------|--------------|
| ğŸ“… **æ—¶é—´åˆ†ç‰‡** | `æŸ¥è¯¢è·¯ç”±ç®€å•ï¼Œä¾¿äºæ•°æ®å½’æ¡£` | `æ•°æ®åˆ†å¸ƒå¯èƒ½ä¸å‡åŒ€` | `æ—¥å¿—ç±»ã€è®¢å•ç±»ä¸šåŠ¡` |
| ğŸ·ï¸ **å“ˆå¸Œåˆ†ç‰‡** | `æ•°æ®åˆ†å¸ƒå‡åŒ€` | `èŒƒå›´æŸ¥è¯¢å›°éš¾` | `ç”¨æˆ·æ•°æ®ã€ç¼“å­˜åœºæ™¯` |
| ğŸ—‚ï¸ **ç›®å½•åˆ†ç‰‡** | `ä¸šåŠ¡é€»è¾‘æ¸…æ™°` | `éœ€è¦ä¸šåŠ¡è§„åˆ™æ”¯æ’‘` | `å¤šç§Ÿæˆ·ã€åœ°åŒºä¸šåŠ¡` |
| ğŸ“Š **èŒƒå›´åˆ†ç‰‡** | `èŒƒå›´æŸ¥è¯¢é«˜æ•ˆ` | `çƒ­ç‚¹æ•°æ®å€¾æ–œ` | `æ•°å€¼å‹ä¸šåŠ¡ä¸»é”®` |

---

## 4. ğŸŒŠ æµå¼æŸ¥è¯¢å¤„ç†æŠ€æœ¯


### 4.1 æµå¼æŸ¥è¯¢æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æµå¼æŸ¥è¯¢**

ä¼ ç»ŸæŸ¥è¯¢ vs æµå¼æŸ¥è¯¢çš„åŒºåˆ«ï¼š
```
ä¼ ç»ŸæŸ¥è¯¢ï¼š
å®¢æˆ·ç«¯å‘é€è¯·æ±‚ â†’ æ•°æ®åº“å¤„ç†å®Œæ‰€æœ‰ç»“æœ â†’ ä¸€æ¬¡æ€§è¿”å›å…¨éƒ¨æ•°æ®
é—®é¢˜ï¼šå¤§ç»“æœé›†å ç”¨å¤§é‡å†…å­˜ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿

æµå¼æŸ¥è¯¢ï¼š
å®¢æˆ·ç«¯å‘é€è¯·æ±‚ â†’ æ•°æ®åº“è¾¹å¤„ç†è¾¹è¿”å› â†’ å®¢æˆ·ç«¯è¾¹æ¥æ”¶è¾¹å¤„ç†
ä¼˜åŠ¿ï¼šå†…å­˜ä½¿ç”¨æ’å®šï¼Œç”¨æˆ·å¯ä»¥ç«‹å³çœ‹åˆ°ç»“æœ
```

**ğŸ“Š æµå¼æŸ¥è¯¢æ¶æ„å›¾**
```
åº”ç”¨ç¨‹åº                     æ•°æ®åº“
    |                         |
    |--[1]å‘é€æŸ¥è¯¢è¯·æ±‚-------->|
    |                         |--[å¼€å§‹æ‰§è¡ŒæŸ¥è¯¢]
    |<-[2]è¿”å›ç¬¬1æ‰¹æ•°æ®-------|<-[è¯»å–å‰100æ¡]
    |--[3]å¤„ç†ç¬¬1æ‰¹æ•°æ®]      |
    |                         |--[ç»§ç»­è¯»å–]
    |<-[4]è¿”å›ç¬¬2æ‰¹æ•°æ®-------|<-[è¯»å–101-200æ¡]
    |--[5]å¤„ç†ç¬¬2æ‰¹æ•°æ®]      |
    |                         |
    |          ...             |          ...
    |                         |
    |<-[N]æ•°æ®ä¼ è¾“å®Œæˆ--------|<-[æŸ¥è¯¢ç»“æŸ]
```

### 4.2 JDBCæµå¼æŸ¥è¯¢å®ç°


**ğŸ’» Javaå®ç°ç¤ºä¾‹**
```java
@Service
public class StreamingQueryService {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * æµå¼å¤„ç†å¤§è¡¨æŸ¥è¯¢
     * æ¯æ¬¡åªåŠ è½½å°‘é‡æ•°æ®åˆ°å†…å­˜ï¼Œé¿å…OOM
     */
    public void processLargeTable(String tableName, OrderProcessor processor) {
        String sql = "SELECT * FROM " + tableName + " ORDER BY id";
        
        jdbcTemplate.query(sql, rs -> {
            int batchSize = 0;
            List<Order> batch = new ArrayList<>();
            
            while (rs.next()) {
                // æ„å»ºå¯¹è±¡
                Order order = new Order();
                order.setId(rs.getLong("id"));
                order.setUserId(rs.getLong("user_id"));
                order.setAmount(rs.getBigDecimal("amount"));
                
                batch.add(order);
                batchSize++;
                
                // æ¯1000æ¡å¤„ç†ä¸€æ‰¹
                if (batchSize >= 1000) {
                    processor.process(batch);
                    batch.clear();
                    batchSize = 0;
                }
            }
            
            // å¤„ç†æœ€åä¸€æ‰¹æ•°æ®
            if (!batch.isEmpty()) {
                processor.process(batch);
            }
        });
    }
}

interface OrderProcessor {
    void process(List<Order> orders);
}
```

### 4.3 æµå¼æŸ¥è¯¢çš„å®é™…åº”ç”¨


**ğŸ“ˆ æ•°æ®å¯¼å‡ºåœºæ™¯**
```java
// å¯¼å‡ºç™¾ä¸‡çº§è®¢å•æ•°æ®
public void exportOrdersToCSV(String fileName) {
    try (PrintWriter writer = new PrintWriter(fileName)) {
        // CSVå¤´éƒ¨
        writer.println("ID,ç”¨æˆ·ID,é‡‘é¢,åˆ›å»ºæ—¶é—´");
        
        // æµå¼æŸ¥è¯¢å¹¶å†™å…¥æ–‡ä»¶
        streamingQueryService.processLargeTable("orders", orders -> {
            for (Order order : orders) {
                writer.println(String.format("%d,%d,%.2f,%s", 
                    order.getId(), 
                    order.getUserId(), 
                    order.getAmount(), 
                    order.getCreateTime()));
            }
            writer.flush(); // åŠæ—¶åˆ·æ–°ï¼Œé˜²æ­¢å†…å­˜ç§¯ç´¯
        });
    }
}
```

**ğŸ’¡ æµå¼æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§**
```
æ•°æ®åº“é…ç½®ä¼˜åŒ–ï¼š
â€¢ è®¾ç½®åˆé€‚çš„fetch sizeï¼ˆå¦‚1000ï¼‰
â€¢ è°ƒæ•´æ•°æ®åº“è¿æ¥çš„ç¼“å†²åŒºå¤§å°
â€¢ ä½¿ç”¨åªè¯»äº‹åŠ¡å‡å°‘é”ç«äº‰

åº”ç”¨å±‚ä¼˜åŒ–ï¼š
â€¢ æ‰¹é‡å¤„ç†ï¼Œè€Œä¸æ˜¯é€æ¡å¤„ç†
â€¢ åŠæ—¶é‡Šæ”¾å·²å¤„ç†çš„æ•°æ®
â€¢ ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œé˜²æ­¢å †ç§¯
â€¢ è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
```

---

## 5. ğŸ“ˆ å¢é‡æŸ¥è¯¢ä¼˜åŒ–


### 5.1 å¢é‡æŸ¥è¯¢çš„æ ¸å¿ƒæ€æƒ³


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¢é‡æŸ¥è¯¢**

å°±åƒçœ‹æŠ¥çº¸ï¼Œæˆ‘ä»¬é€šå¸¸åªå…³å¿ƒä»Šå¤©çš„æ–°é—»ï¼Œè€Œä¸éœ€è¦é‡æ–°è¯»ä¸€éå†å²ä¸Šæ‰€æœ‰çš„æ–°é—»ï¼š

```
å…¨é‡æŸ¥è¯¢ï¼ˆæ•ˆç‡ä½ï¼‰ï¼š
æ¯æ¬¡æŸ¥è¯¢ â†’ æ‰«ææ•´ä¸ªè¡¨ â†’ è¿”å›æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®
é—®é¢˜ï¼šé‡å¤æŸ¥è¯¢å¤§é‡æœªå˜åŒ–çš„å†å²æ•°æ®

å¢é‡æŸ¥è¯¢ï¼ˆé«˜æ•ˆï¼‰ï¼š
é¦–æ¬¡æŸ¥è¯¢ â†’ è·å–åŸºçº¿æ•°æ® â†’ è®°å½•æŸ¥è¯¢æ—¶é—´ç‚¹
åç»­æŸ¥è¯¢ â†’ åªæŸ¥è¯¢å˜åŒ–çš„æ•°æ® â†’ ä¸åŸºçº¿åˆå¹¶
ä¼˜åŠ¿ï¼šæŸ¥è¯¢æ•°æ®é‡å¤§å¹…å‡å°‘
```

### 5.2 åŸºäºæ—¶é—´æˆ³çš„å¢é‡æŸ¥è¯¢


**â° æ—¶é—´æˆ³å­—æ®µè®¾è®¡**

æ¯ä¸ªå¤§è¡¨éƒ½åº”è¯¥æœ‰è¿™äº›æ—¶é—´å­—æ®µï¼š
```sql
-- è¡¨ç»“æ„è®¾è®¡
CREATE TABLE orders (
    id BIGINT PRIMARY KEY,
    user_id BIGINT,
    amount DECIMAL(10,2),
    status VARCHAR(20),
    
    -- å…³é”®ï¼šæ—¶é—´æˆ³å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           -- åˆ›å»ºæ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, -- æ›´æ–°æ—¶é—´
    
    -- ä¸ºæ—¶é—´å­—æ®µå»ºç«‹ç´¢å¼•
    INDEX idx_created_at (created_at),
    INDEX idx_updated_at (updated_at)
);
```

**ğŸ” å¢é‡æŸ¥è¯¢å®ç°**
```java
@Service
public class IncrementalQueryService {
    
    private static final String LAST_SYNC_TIME_KEY = "last_sync_time:orders";
    
    /**
     * è·å–å¢é‡è®¢å•æ•°æ®
     */
    public List<Order> getIncrementalOrders() {
        // è·å–ä¸Šæ¬¡åŒæ­¥æ—¶é—´
        String lastSyncStr = redis.opsForValue().get(LAST_SYNC_TIME_KEY);
        Timestamp lastSyncTime = lastSyncStr != null ? 
            Timestamp.valueOf(lastSyncStr) : 
            Timestamp.valueOf("1970-01-01 00:00:00");
        
        // å½“å‰æ—¶é—´
        Timestamp currentTime = new Timestamp(System.currentTimeMillis());
        
        // åªæŸ¥è¯¢å˜åŒ–çš„æ•°æ®
        String sql = """
            SELECT * FROM orders 
            WHERE updated_at > ? AND updated_at <= ?
            ORDER BY updated_at ASC
        """;
        
        List<Order> incrementalData = jdbcTemplate.query(sql, 
            new Object[]{lastSyncTime, currentTime}, 
            new OrderRowMapper());
        
        // æ›´æ–°åŒæ­¥æ—¶é—´ç‚¹
        redis.opsForValue().set(LAST_SYNC_TIME_KEY, currentTime.toString());
        
        return incrementalData;
    }
}
```

### 5.3 åŸºäºç‰ˆæœ¬å·çš„å¢é‡æŸ¥è¯¢


**ğŸ·ï¸ ç‰ˆæœ¬å·æœºåˆ¶**

å¯¹äºå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æ¥è¿½è¸ªæ•°æ®å˜åŒ–ï¼š
```sql
-- å¢åŠ ç‰ˆæœ¬å·å­—æ®µ
ALTER TABLE orders ADD COLUMN version BIGINT DEFAULT 1;

-- æ•°æ®æ›´æ–°æ—¶é€’å¢ç‰ˆæœ¬å·
UPDATE orders 
SET amount = 150.00, 
    version = version + 1,
    updated_at = CURRENT_TIMESTAMP
WHERE id = 12345;
```

**ğŸ”„ å¢é‡åŒæ­¥é€»è¾‘**
```java
public class VersionBasedSync {
    
    public void syncIncrementalData() {
        // è·å–æœ¬åœ°æœ€å¤§ç‰ˆæœ¬å·
        Long localMaxVersion = getLocalMaxVersion();
        
        // æŸ¥è¯¢è¿œç¨‹å¢é‡æ•°æ®
        String sql = """
            SELECT * FROM orders 
            WHERE version > ? 
            ORDER BY version ASC
            LIMIT 10000
        """;
        
        List<Order> incrementalData = query(sql, localMaxVersion);
        
        // å¤„ç†å¢é‡æ•°æ®
        for (Order order : incrementalData) {
            if (order.isDeleted()) {
                deleteLocal(order.getId());
            } else {
                upsertLocal(order); // æ’å…¥æˆ–æ›´æ–°
            }
        }
        
        // æ›´æ–°æœ¬åœ°ç‰ˆæœ¬å·
        if (!incrementalData.isEmpty()) {
            Long newMaxVersion = incrementalData.stream()
                .map(Order::getVersion)
                .max(Long::compare)
                .orElse(localMaxVersion);
            updateLocalMaxVersion(newMaxVersion);
        }
    }
}
```

### 5.4 CDCå¢é‡æ•è·æŠ€æœ¯


**ğŸ”¸ ä»€ä¹ˆæ˜¯CDC**

CDCï¼ˆChange Data Captureï¼‰å°±åƒç»™æ•°æ®åº“å®‰è£…äº†ä¸€ä¸ª"å˜åŒ–ç›‘æ§å™¨"ï¼š
```
CDCå·¥ä½œåŸç†ï¼š
æ•°æ®åº“æ“ä½œ â†’ è®°å½•åˆ°å˜æ›´æ—¥å¿— â†’ CDCå·¥å…·æ•è· â†’ å‘é€åˆ°ä¸‹æ¸¸ç³»ç»Ÿ

æ”¯æŒçš„æ“ä½œç±»å‹ï¼š
â€¢ INSERTï¼šæ–°å¢æ•°æ®
â€¢ UPDATEï¼šä¿®æ”¹æ•°æ®  
â€¢ DELETEï¼šåˆ é™¤æ•°æ®
```

**ğŸ’» CDCåº”ç”¨ç¤ºä¾‹**
```java
// ä½¿ç”¨Debezium CDCçš„æ¶ˆæ¯å¤„ç†
@Component
public class OrderChangeListener {
    
    @EventListener
    public void handleOrderChange(OrderChangeEvent event) {
        switch (event.getOperation()) {
            case "c": // CREATE
                processNewOrder(event.getAfter());
                break;
                
            case "u": // UPDATE
                processOrderUpdate(event.getBefore(), event.getAfter());
                break;
                
            case "d": // DELETE
                processOrderDeletion(event.getBefore());
                break;
        }
        
        // æ›´æ–°ç¼“å­˜
        refreshCache(event.getOrderId());
    }
}
```

---

## 6. ğŸ’¾ ç¼“å­˜ä¸é¢„å¤„ç†ç­–ç•¥


### 6.1 å¤šå±‚ç¼“å­˜æ¶æ„


**ğŸ—ï¸ ç¼“å­˜å±‚æ¬¡è®¾è®¡**

```
ç”¨æˆ·è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨ç¼“å­˜       â”‚ â† é™æ€èµ„æºã€é¡µé¢ç¼“å­˜
â”‚ (Browser Cache) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CDNç¼“å­˜         â”‚ â† å…¨çƒåˆ†å‘ï¼Œå°±è¿‘è®¿é—®
â”‚ (CDN Cache)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨å±‚ç¼“å­˜       â”‚ â† çƒ­ç‚¹æŸ¥è¯¢ç»“æœ
â”‚ (App Cache)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®åº“æŸ¥è¯¢ç¼“å­˜   â”‚ â† æŸ¥è¯¢ç»“æœé›†ç¼“å­˜
â”‚ (Query Cache)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®åº“          â”‚ â† æœ€ç»ˆçš„æ•°æ®æº
â”‚ (Database)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æŸ¥è¯¢ç»“æœç¼“å­˜ç­–ç•¥


**ğŸ¯ æ™ºèƒ½ç¼“å­˜ç­–ç•¥**
```java
@Service
public class SmartCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redis;
    
    public PageResult<Order> getCachedOrderPage(OrderQueryParam param) {
        // æ„å»ºç¼“å­˜Key
        String cacheKey = buildCacheKey(param);
        
        // å°è¯•ä»ç¼“å­˜è·å–
        PageResult<Order> cached = redis.opsForValue().get(cacheKey);
        if (cached != null) {
            return cached;
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        PageResult<Order> result = queryFromDatabase(param);
        
        // æ ¹æ®æŸ¥è¯¢ç±»å‹è®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´
        int ttl = calculateTTL(param);
        redis.opsForValue().set(cacheKey, result, ttl, TimeUnit.SECONDS);
        
        return result;
    }
    
    private int calculateTTL(OrderQueryParam param) {
        // çƒ­ç‚¹æŸ¥è¯¢ï¼ˆé¦–é¡µã€ä»Šæ—¥æ•°æ®ï¼‰ï¼šè¾ƒé•¿ç¼“å­˜æ—¶é—´
        if (param.isHotQuery()) {
            return 300; // 5åˆ†é’Ÿ
        }
        
        // å†å²æ•°æ®æŸ¥è¯¢ï¼šæ›´é•¿ç¼“å­˜æ—¶é—´
        if (param.isHistoricalQuery()) {
            return 1800; // 30åˆ†é’Ÿ
        }
        
        // æ™®é€šæŸ¥è¯¢ï¼šæ ‡å‡†ç¼“å­˜æ—¶é—´
        return 120; // 2åˆ†é’Ÿ
    }
}
```

### 6.3 æ•°æ®é¢„å¤„ç†ç­–ç•¥


**ğŸ”„ å®šæ—¶èšåˆé¢„å¤„ç†**

å¯¹äºç»Ÿè®¡ç±»æŸ¥è¯¢ï¼Œæå‰è®¡ç®—å¥½ç»“æœï¼š
```sql
-- æ¯æ—¥è®¢å•ç»Ÿè®¡é¢„å¤„ç†
CREATE TABLE daily_order_stats (
    stat_date DATE PRIMARY KEY,
    total_orders INT,
    total_amount DECIMAL(15,2),
    avg_amount DECIMAL(10,2),
    top_category VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ
INSERT INTO daily_order_stats (stat_date, total_orders, total_amount, avg_amount)
SELECT 
    DATE(create_time) as stat_date,
    COUNT(*) as total_orders,
    SUM(amount) as total_amount,
    AVG(amount) as avg_amount
FROM orders 
WHERE DATE(create_time) = CURDATE() - INTERVAL 1 DAY
GROUP BY DATE(create_time);
```

**ğŸ“Š å®æ—¶ç»Ÿè®¡ç¼“å­˜**
```java
@Component
public class RealTimeStatsCache {
    
    private final Map<String, AtomicLong> counters = new ConcurrentHashMap<>();
    private final Map<String, AtomicReference<BigDecimal>> amounts = new ConcurrentHashMap<>();
    
    /**
     * å®æ—¶æ›´æ–°ç»Ÿè®¡æ•°æ®
     */
    @EventListener
    public void onOrderCreated(OrderCreatedEvent event) {
        String dateKey = LocalDate.now().toString();
        
        // æ›´æ–°ä»Šæ—¥è®¢å•æ•°
        counters.computeIfAbsent("orders:" + dateKey, k -> new AtomicLong(0))
                .incrementAndGet();
        
        // æ›´æ–°ä»Šæ—¥é‡‘é¢
        amounts.computeIfAbsent("amount:" + dateKey, k -> new AtomicReference<>(BigDecimal.ZERO))
                .updateAndGet(current -> current.add(event.getAmount()));
    }
    
    /**
     * è·å–ä»Šæ—¥ç»Ÿè®¡æ•°æ®ï¼ˆæ¯«ç§’çº§å“åº”ï¼‰
     */
    public TodayStats getTodayStats() {
        String today = LocalDate.now().toString();
        
        long todayOrders = counters.getOrDefault("orders:" + today, new AtomicLong(0)).get();
        BigDecimal todayAmount = amounts.getOrDefault("amount:" + today, 
            new AtomicReference<>(BigDecimal.ZERO)).get();
        
        return new TodayStats(todayOrders, todayAmount);
    }
}
```

---

## 7. âš¡ èµ„æºæ§åˆ¶ä¸ç›‘æ§


### 7.1 æŸ¥è¯¢èµ„æºé™åˆ¶


**ğŸ›¡ï¸ æ•°æ®åº“çº§åˆ«é™åˆ¶**
```sql
-- MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨é…ç½®
SET SESSION max_execution_time = 30000;  -- æœ€å¤§æ‰§è¡Œ30ç§’
SET SESSION sql_buffer_result = ON;      -- ç¼“å­˜ç»“æœé›†
SET SESSION query_cache_type = ON;       -- å¼€å¯æŸ¥è¯¢ç¼“å­˜

-- é™åˆ¶æŸ¥è¯¢æ‰«æçš„è®°å½•æ•°
SET SESSION max_seeks_for_key = 1000;

-- é™åˆ¶å†…å­˜ä½¿ç”¨
SET SESSION sort_buffer_size = 2097152;  -- æ’åºç¼“å†²åŒº2MB
SET SESSION read_buffer_size = 131072;   -- è¯»ç¼“å†²åŒº128KB
```

### 7.2 åº”ç”¨å±‚é™æµæ§åˆ¶


**ğŸš¦ æŸ¥è¯¢é¢‘ç‡é™åˆ¶**
```java
@Component
public class QueryRateLimiter {
    
    // ä½¿ç”¨Google Guavaçš„RateLimiter
    private final RateLimiter rateLimiter = RateLimiter.create(10.0); // æ¯ç§’10ä¸ªæŸ¥è¯¢
    
    public <T> T executeQuery(Supplier<T> querySupplier) {
        // è·å–ä»¤ç‰Œï¼Œæ²¡æœ‰ä»¤ç‰Œå°±ç­‰å¾…
        if (!rateLimiter.tryAcquire(2, TimeUnit.SECONDS)) {
            throw new ServiceException("æŸ¥è¯¢é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åå†è¯•");
        }
        
        return querySupplier.get();
    }
}
```

### 7.3 æŸ¥è¯¢æ€§èƒ½ç›‘æ§


**ğŸ“Š ç›‘æ§æŒ‡æ ‡ä½“ç³»**
```java
@Component
public class QueryPerformanceMonitor {
    
    private final MeterRegistry meterRegistry;
    
    public <T> T monitorQuery(String queryType, Supplier<T> query) {
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            T result = query.get();
            
            // è®°å½•æˆåŠŸæŸ¥è¯¢
            meterRegistry.counter("query.success", "type", queryType).increment();
            
            return result;
            
        } catch (Exception e) {
            // è®°å½•å¤±è´¥æŸ¥è¯¢
            meterRegistry.counter("query.error", "type", queryType, "error", e.getClass().getSimpleName()).increment();
            throw e;
            
        } finally {
            // è®°å½•æŸ¥è¯¢è€—æ—¶
            sample.stop(Timer.builder("query.duration")
                .tag("type", queryType)
                .register(meterRegistry));
        }
    }
}
```

**ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡ç›‘æ§**
```
å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š

æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡ï¼š
â€¢ å¹³å‡æŸ¥è¯¢æ—¶é—´
â€¢ 95%ã€99%åˆ†ä½æ•°å“åº”æ—¶é—´
â€¢ QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰
â€¢ æŸ¥è¯¢æˆåŠŸç‡

èµ„æºä½¿ç”¨æŒ‡æ ‡ï¼š
â€¢ CPUä½¿ç”¨ç‡
â€¢ å†…å­˜ä½¿ç”¨é‡
â€¢ ç£ç›˜IO wait
â€¢ ç½‘ç»œIOçŠ¶å†µ

ä¸šåŠ¡æŒ‡æ ‡ï¼š
â€¢ æ…¢æŸ¥è¯¢æ•°é‡
â€¢ è¶…æ—¶æŸ¥è¯¢æ¯”ä¾‹
â€¢ ç”¨æˆ·æ»¡æ„åº¦ï¼ˆå“åº”æ—¶é—´<2sçš„æ¯”ä¾‹ï¼‰
```

---

## 8. ğŸ¯ å¤§è¡¨ä¼˜åŒ–å®æˆ˜æ¡ˆä¾‹


### 8.1 ç”µå•†è®¢å•è¡¨ä¼˜åŒ–æ¡ˆä¾‹


**ğŸ“‹ é—®é¢˜èƒŒæ™¯**
```
ä¸šåŠ¡åœºæ™¯ï¼š
â€¢ è®¢å•è¡¨ï¼š5000ä¸‡è®°å½•ï¼Œå¢é•¿500ä¸‡/æœˆ
â€¢ ä¸»è¦æŸ¥è¯¢ï¼šè®¢å•åˆ—è¡¨ã€è®¢å•è¯¦æƒ…ã€ç»Ÿè®¡æŠ¥è¡¨
â€¢ æ€§èƒ½é—®é¢˜ï¼šåˆ—è¡¨æŸ¥è¯¢è¶…è¿‡10ç§’ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
```

**ğŸ”§ ç»¼åˆä¼˜åŒ–æ–¹æ¡ˆ**
```sql
-- 1. æŒ‰æ—¶é—´åˆ†åŒº
CREATE TABLE orders (
    id BIGINT AUTO_INCREMENT,
    user_id BIGINT,
    amount DECIMAL(10,2),
    status VARCHAR(20),
    create_time TIMESTAMP,
    
    PRIMARY KEY (id, create_time)  -- æ³¨æ„ï¼šåŒ…å«åˆ†åŒºå­—æ®µ
) PARTITION BY RANGE (YEAR(create_time)) (
    PARTITION p2022 VALUES LESS THAN (2023),
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026)
);

-- 2. åˆ›å»ºè¦†ç›–ç´¢å¼•
CREATE INDEX idx_user_status_time ON orders (user_id, status, create_time DESC);
CREATE INDEX idx_status_time ON orders (status, create_time DESC) COVERING (id, amount);
```

### 8.2 ä¼˜åŒ–æ•ˆæœå¯¹æ¯”


**ğŸ“Š ä¼˜åŒ–å‰åæ€§èƒ½å¯¹æ¯”**

| æŸ¥è¯¢ç±»å‹ | **ä¼˜åŒ–å‰** | **ä¼˜åŒ–å** | **æå‡æ¯”ä¾‹** |
|----------|-----------|-----------|-------------|
| ğŸ” **ç”¨æˆ·è®¢å•åˆ—è¡¨** | `8.5ç§’` | `0.3ç§’` | `28å€æå‡` |
| ğŸ“„ **è®¢å•åˆ†é¡µæŸ¥è¯¢** | `12ç§’` | `0.8ç§’` | `15å€æå‡` |
| ğŸ“Š **æ—¥ç»Ÿè®¡æŸ¥è¯¢** | `45ç§’` | `2.1ç§’` | `21å€æå‡` |
| ğŸ” **è®¢å•è¯¦æƒ…æŸ¥è¯¢** | `1.2ç§’` | `0.05ç§’` | `24å€æå‡` |

**ğŸ’° æˆæœ¬æ•ˆç›Šåˆ†æ**
```
ç¡¬ä»¶èµ„æºèŠ‚çœï¼š
â€¢ CPUä½¿ç”¨ç‡ï¼šä»80%é™åˆ°30%
â€¢ å†…å­˜ä½¿ç”¨ï¼šä»16GBé™åˆ°8GB
â€¢ ç£ç›˜IOï¼šå‡å°‘70%çš„éšæœºè¯»å–

ä¸šåŠ¡ä»·å€¼ï¼š
â€¢ ç”¨æˆ·æ»¡æ„åº¦æå‡ï¼šé¡µé¢å“åº”æ—¶é—´<2ç§’
â€¢ å¹¶å‘èƒ½åŠ›æå‡ï¼šæ”¯æŒ3å€çš„å¹¶å‘ç”¨æˆ·
â€¢ ç»´æŠ¤æˆæœ¬é™ä½ï¼šå‡å°‘äº†æœåŠ¡å™¨æ‰©å®¹éœ€æ±‚
```

### 8.3 å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯ç®¡ç†


**ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯çš„é‡è¦æ€§**

æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–å™¨éœ€è¦å‡†ç¡®çš„ç»Ÿè®¡ä¿¡æ¯æ¥é€‰æ‹©æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ï¼š
```sql
-- æŸ¥çœ‹è¡¨çš„ç»Ÿè®¡ä¿¡æ¯
SHOW TABLE STATUS LIKE 'orders';

-- æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE orders;

-- è®¾ç½®è‡ªåŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
-- MySQL 8.0+
SET PERSIST information_schema_stats_expiry = 3600; -- 1å°æ—¶æ›´æ–°ä¸€æ¬¡
```

**ğŸ”§ ç»Ÿè®¡ä¿¡æ¯ç»´æŠ¤ç­–ç•¥**
```java
@Component
@Scheduled
public class StatisticsMaintenanceJob {
    
    /**
     * æ¯å¤©å‡Œæ™¨2ç‚¹æ›´æ–°å¤§è¡¨ç»Ÿè®¡ä¿¡æ¯
     */
    @Scheduled(cron = "0 0 2 * * ?")
    public void updateTableStatistics() {
        List<String> largeTables = Arrays.asList(
            "orders", "order_items", "user_behavior_log"
        );
        
        for (String table : largeTables) {
            try {
                // æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
                jdbcTemplate.execute("ANALYZE TABLE " + table);
                
                // è®°å½•ç»Ÿè®¡ä¿¡æ¯æ›´æ–°æ—¶é—´
                redis.opsForValue().set("stats_updated:" + table, 
                    System.currentTimeMillis(), 
                    24, TimeUnit.HOURS);
                
                log.info("Updated statistics for table: {}", table);
                
            } catch (Exception e) {
                log.error("Failed to update statistics for table: {}", table, e);
            }
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¤§è¡¨æŸ¥è¯¢ä¼˜åŒ–æœ¬è´¨ï¼šå‡å°‘æ•°æ®æ‰«æé‡ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡
ğŸ”¸ åˆ†é¡µä¼˜åŒ–ï¼šä½¿ç”¨æ¸¸æ ‡åˆ†é¡µæ›¿ä»£OFFSETï¼Œæ€§èƒ½ç¨³å®š
ğŸ”¸ æ•°æ®åˆ†ç‰‡ï¼šåŒ–æ•´ä¸ºé›¶ï¼Œå¹¶è¡Œå¤„ç†ï¼Œåˆ†æ•£å‹åŠ›
ğŸ”¸ æµå¼æŸ¥è¯¢ï¼šè¾¹è¯»è¾¹å¤„ç†ï¼Œå†…å­˜ä½¿ç”¨æ’å®š
ğŸ”¸ å¢é‡æŸ¥è¯¢ï¼šåªå¤„ç†å˜åŒ–æ•°æ®ï¼Œå¤§å¹…æå‡æ•ˆç‡
ğŸ”¸ å¤šå±‚ç¼“å­˜ï¼šå‡å°‘æ•°æ®åº“è®¿é—®ï¼Œæå‡å“åº”é€Ÿåº¦
ğŸ”¸ èµ„æºæ§åˆ¶ï¼šé™æµã€ç›‘æ§ã€å‘Šè­¦ï¼Œä¿éšœç³»ç»Ÿç¨³å®š
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆä¼ ç»Ÿåˆ†é¡µä¼šè¶Šæ¥è¶Šæ…¢**
```
æ ¹æœ¬åŸå› ï¼šOFFSETéœ€è¦è·³è¿‡å¤§é‡è®°å½•
è§£å†³æ€è·¯ï¼šç”¨WHEREæ¡ä»¶ä»£æ›¿OFFSETè·³è·ƒ

ä¼ ç»Ÿæ€è·¯ï¼šè·³è¿‡å‰Næ¡è®°å½•
ä¼˜åŒ–æ€è·¯ï¼šæ‰¾åˆ°å¤§äºæŸä¸ªå€¼çš„å‰Næ¡è®°å½•
```

**ğŸ”¹ åˆ†ç‰‡çš„æ ¸å¿ƒä»·å€¼**
```
æ€§èƒ½è§’åº¦ï¼š
â€¢ å•è¡¨æ•°æ®é‡å‡å°‘ â†’ ç´¢å¼•æ•ˆç‡æé«˜
â€¢ å¹¶è¡ŒæŸ¥è¯¢ â†’ å……åˆ†åˆ©ç”¨å¤šæ ¸å’Œå¤šç£ç›˜
â€¢ çƒ­ç‚¹åˆ†ç¦» â†’ é¿å…å•è¡¨æˆä¸ºç“¶é¢ˆ

ç»´æŠ¤è§’åº¦ï¼š
â€¢ å¤‡ä»½æ¢å¤æ›´å¿«
â€¢ ç´¢å¼•é‡å»ºæ›´å¿«
â€¢ å†å²æ•°æ®å½’æ¡£æ›´å®¹æ˜“
```

**ğŸ”¹ æµå¼å¤„ç†çš„é€‚ç”¨åœºæ™¯**
```
é€‚åˆæµå¼ï¼š
âœ… æ•°æ®å¯¼å‡ºï¼ˆå¤§é‡æ•°æ®ï¼Œä¸éœ€è¦éšæœºè®¿é—®ï¼‰
âœ… æ•°æ®ETLï¼ˆæ•°æ®è½¬æ¢å¤„ç†ï¼‰
âœ… æ‰¹é‡ç»Ÿè®¡ï¼ˆé€æ¡æˆ–åˆ†æ‰¹å¤„ç†ï¼‰

ä¸é€‚åˆæµå¼ï¼š
âŒ åˆ†é¡µå±•ç¤ºï¼ˆç”¨æˆ·éœ€è¦è·³é¡µï¼‰
âŒ éšæœºæŸ¥è¯¢ï¼ˆéœ€è¦æ ¹æ®æ¡ä»¶å¿«é€Ÿå®šä½ï¼‰
âŒ å®æ—¶äº¤äº’ï¼ˆç”¨æˆ·ç­‰ä¸äº†æ…¢æ…¢åŠ è½½ï¼‰
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼åŸåˆ™


**ğŸ¯ ä¼˜åŒ–ä¼˜å…ˆçº§**
```
1. ç´¢å¼•ä¼˜åŒ–ï¼ˆæŠ•å…¥å°ï¼Œæ”¶ç›Šå¤§ï¼‰
   â†“
2. SQLè¯­å¥ä¼˜åŒ–ï¼ˆæ”¹å†™æŸ¥è¯¢é€»è¾‘ï¼‰
   â†“  
3. ç¼“å­˜ç­–ç•¥ï¼ˆåº”ç”¨å±‚ä¼˜åŒ–ï¼‰
   â†“
4. æ•°æ®åˆ†ç‰‡ï¼ˆæ¶æ„å±‚ä¼˜åŒ–ï¼Œæˆæœ¬è¾ƒé«˜ï¼‰
   â†“
5. ç¡¬ä»¶å‡çº§ï¼ˆæœ€åé€‰æ‹©ï¼‰
```

**ğŸ”§ å®æ–½å»ºè®®**
```
æ¸è¿›å¼ä¼˜åŒ–ï¼š
1. å…ˆè§£å†³æœ€ç—›çš„é—®é¢˜ï¼ˆå¦‚æ·±åˆ†é¡µï¼‰
2. é€æ­¥å®Œå–„ç›‘æ§ä½“ç³»
3. æ ¹æ®ä¸šåŠ¡å¢é•¿è°ƒæ•´ç­–ç•¥
4. æŒç»­ä¼˜åŒ–ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å·¥ç¨‹

æŠ€æœ¯é€‰æ‹©ï¼š
â€¢ ä¼˜å…ˆä½¿ç”¨æˆç†Ÿçš„æŠ€æœ¯æ–¹æ¡ˆ
â€¢ è€ƒè™‘å›¢é˜Ÿçš„æŠ€æœ¯èƒ½åŠ›å’Œç»´æŠ¤æˆæœ¬
â€¢ å¹³è¡¡æ€§èƒ½æå‡ä¸ç³»ç»Ÿå¤æ‚åº¦
```

### 9.4 é¿å…å¸¸è§è¯¯åŒº


**âŒ å¸¸è§çš„é”™è¯¯åšæ³•**
```
è¯¯åŒº1ï¼šä¸€å‘³å¢åŠ ç´¢å¼•
æ­£ç¡®ï¼šåˆ†ææŸ¥è¯¢æ¨¡å¼ï¼Œåˆ›å»ºåˆé€‚çš„ç´¢å¼•

è¯¯åŒº2ï¼šè¿‡åº¦ä¾èµ–ç¼“å­˜
æ­£ç¡®ï¼šç¼“å­˜+æ•°æ®åº“ä¼˜åŒ–å¹¶é‡

è¯¯åŒº3ï¼šç›²ç›®åˆ†è¡¨åˆ†åº“
æ­£ç¡®ï¼šå…ˆä¼˜åŒ–å•è¡¨ï¼Œç¡®å®éœ€è¦æ—¶å†åˆ†ç‰‡

è¯¯åŒº4ï¼šå¿½ç•¥ç›‘æ§
æ­£ç¡®ï¼šå»ºç«‹å®Œå–„çš„æ€§èƒ½ç›‘æ§ä½“ç³»
```

**âœ… æ­£ç¡®çš„ä¼˜åŒ–æ€è·¯**
```
1. å…ˆåˆ†æé—®é¢˜ï¼šå“ªäº›æŸ¥è¯¢æ…¢ï¼Œä¸ºä»€ä¹ˆæ…¢
2. å¯¹ç—‡ä¸‹è¯ï¼šé€‰æ‹©åˆé€‚çš„ä¼˜åŒ–æŠ€æœ¯
3. é€æ­¥å®æ–½ï¼šå°æ­¥å¿«è·‘ï¼ŒæŒç»­æ”¹è¿›
4. ç›‘æ§éªŒè¯ï¼šé€šè¿‡æ•°æ®éªŒè¯ä¼˜åŒ–æ•ˆæœ
5. æ–‡æ¡£è®°å½•ï¼šè®°å½•ä¼˜åŒ–è¿‡ç¨‹å’Œæ•ˆæœ
```

> ğŸ’¡ **æ ¸å¿ƒè®°å¿†è¦ç‚¹**
> 
> å¤§è¡¨ä¼˜åŒ–çš„æœ¬è´¨æ˜¯**å‡å°‘æ— æ•ˆæ•°æ®æ‰«æ**ï¼š
> - é€šè¿‡**ç´¢å¼•**å¿«é€Ÿå®šä½æ•°æ®
> - é€šè¿‡**åˆ†ç‰‡**å‡å°‘å•æ¬¡æ‰«æé‡  
> - é€šè¿‡**ç¼“å­˜**é¿å…é‡å¤æŸ¥è¯¢
> - é€šè¿‡**æµå¼å¤„ç†**æ§åˆ¶å†…å­˜ä½¿ç”¨
> - é€šè¿‡**å¢é‡æŸ¥è¯¢**å‡å°‘é‡å¤è®¡ç®—

**ğŸ¯ æœ€ä½³å®è·µæ€»ç»“**ï¼š
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šæ¸¸æ ‡åˆ†é¡µ + è¦†ç›–ç´¢å¼• + åˆç†WHEREæ¡ä»¶
- **æ¶æ„ä¼˜åŒ–**ï¼šåˆç†åˆ†ç‰‡ + å¤šå±‚ç¼“å­˜ + è¯»å†™åˆ†ç¦»
- **è¿ç»´ä¼˜åŒ–**ï¼šæ€§èƒ½ç›‘æ§ + èµ„æºæ§åˆ¶ + å®šæœŸç»´æŠ¤