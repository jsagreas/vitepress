---
title: 3ã€SQLè°ƒä¼˜å·¥å…·ä½¿ç”¨
---
## ğŸ“š ç›®å½•


1. [SQLè°ƒä¼˜å·¥å…·æ¦‚è¿°](#1-SQLè°ƒä¼˜å·¥å…·æ¦‚è¿°)
2. [EXPLAINæ‰§è¡Œè®¡åˆ’åˆ†æ](#2-EXPLAINæ‰§è¡Œè®¡åˆ’åˆ†æ)
3. [æ€§èƒ½åˆ†æå·¥å…·è¯¦è§£](#3-æ€§èƒ½åˆ†æå·¥å…·è¯¦è§£)
4. [æ…¢æŸ¥è¯¢åˆ†æç³»ç»Ÿ](#4-æ…¢æŸ¥è¯¢åˆ†æç³»ç»Ÿ)
5. [ç¬¬ä¸‰æ–¹è°ƒä¼˜å·¥å…·](#5-ç¬¬ä¸‰æ–¹è°ƒä¼˜å·¥å…·)
6. [è‡ªåŠ¨åŒ–è°ƒä¼˜å¹³å°](#6-è‡ªåŠ¨åŒ–è°ƒä¼˜å¹³å°)
7. [è°ƒä¼˜å·¥å…·é›†æˆæ–¹æ¡ˆ](#7-è°ƒä¼˜å·¥å…·é›†æˆæ–¹æ¡ˆ)
8. [å·¥å…·é€‰å‹ä¸æ•ˆæœè¯„ä¼°](#8-å·¥å…·é€‰å‹ä¸æ•ˆæœè¯„ä¼°)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” SQLè°ƒä¼˜å·¥å…·æ¦‚è¿°



### 1.1 ä¸ºä»€ä¹ˆéœ€è¦è°ƒä¼˜å·¥å…·



**ğŸ’¡ è°ƒä¼˜å·¥å…·çš„ä»·å€¼**
```
SQLè°ƒä¼˜å°±åƒåŒ»ç”Ÿçœ‹ç—…ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‘ç°ç—‡çŠ¶   â”‚ â†’ â”‚   è¯Šæ–­ç—…å›    â”‚ â†’ â”‚   å¯¹ç—‡ä¸‹è¯   â”‚
â”‚  æŸ¥è¯¢å¾ˆæ…¢    â”‚    â”‚  æ‰§è¡Œè®¡åˆ’å·®  â”‚    â”‚  æ·»åŠ ç´¢å¼•    â”‚
â”‚  CPUå ç”¨é«˜   â”‚    â”‚  å…¨è¡¨æ‰«æ    â”‚    â”‚  ä¼˜åŒ–æŸ¥è¯¢    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ²¡æœ‰å·¥å…·çš„ç—›è‹¦ï¼š
âŒ å‡­æ„Ÿè§‰çŒœæµ‹é—®é¢˜åŸå› 
âŒ ç›²ç›®æ·»åŠ ç´¢å¼•
âŒ æ— æ³•é‡åŒ–ä¼˜åŒ–æ•ˆæœ
âŒ é—®é¢˜é‡å¤å‡ºç°

æœ‰å·¥å…·çš„å¥½å¤„ï¼š
âœ… ç²¾ç¡®å®šä½æ€§èƒ½ç“¶é¢ˆ
âœ… æ•°æ®é©±åŠ¨çš„ä¼˜åŒ–å†³ç­–
âœ… é‡åŒ–ä¼˜åŒ–æ•ˆæœ
âœ… å»ºç«‹æ€§èƒ½åŸºçº¿
```

### 1.2 è°ƒä¼˜å·¥å…·åˆ†ç±»



**ğŸ·ï¸ æŒ‰åŠŸèƒ½åˆ†ç±»**
```
è¯Šæ–­åˆ†æç±»ï¼š
â”œâ”€ EXPLAINï¼šæŸ¥çœ‹æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’
â”œâ”€ SHOW PROFILEï¼šåˆ†ææŸ¥è¯¢å„é˜¶æ®µè€—æ—¶
â”œâ”€ Performance Schemaï¼šå®æ—¶æ€§èƒ½ç›‘æ§
â””â”€ æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•æ…¢æŸ¥è¯¢è¯¦æƒ…

ç›‘æ§å‘Šè­¦ç±»ï¼š
â”œâ”€ MySQL Enterprise Monitorï¼šå•†ä¸šç›‘æ§æ–¹æ¡ˆ
â”œâ”€ Prometheus + Grafanaï¼šå¼€æºç›‘æ§æ ˆ
â”œâ”€ Zabbixï¼šé€šç”¨ç›‘æ§å¹³å°
â””â”€ äº‘å¹³å°ç›‘æ§ï¼šRDSç›‘æ§ã€CloudWatchç­‰

ä¼˜åŒ–å»ºè®®ç±»ï¼š
â”œâ”€ pt-query-digestï¼šæŸ¥è¯¢åˆ†ææŠ¥å‘Š
â”œâ”€ MySQL Tunerï¼šé…ç½®ä¼˜åŒ–å»ºè®®
â”œâ”€ Percona Toolkitï¼šæ€§èƒ½ä¼˜åŒ–å·¥å…·é›†
â””â”€ AIè°ƒä¼˜å·¥å…·ï¼šæ™ºèƒ½ä¼˜åŒ–å»ºè®®

é›†æˆå¹³å°ç±»ï¼š
â”œâ”€ MySQL Workbenchï¼šå›¾å½¢åŒ–ç®¡ç†
â”œâ”€ phpMyAdminï¼šWebç®¡ç†ç•Œé¢
â”œâ”€ DBeaverï¼šé€šç”¨æ•°æ®åº“å·¥å…·
â””â”€ DataGripï¼šJetBrainsä¸“ä¸šå·¥å…·
```

### 1.3 å·¥å…·é€‰æ‹©ç­–ç•¥



**ğŸ¯ é€‰æ‹©åŸåˆ™**
```
åœºæ™¯åŒ¹é…ï¼š
ğŸ”¸ å¼€å‘é˜¶æ®µï¼šEXPLAIN + SHOW PROFILEï¼ˆå¿«é€Ÿå®šä½ï¼‰
ğŸ”¸ æµ‹è¯•é˜¶æ®µï¼šPerformance Schema + æ…¢æŸ¥è¯¢ï¼ˆæ·±åº¦åˆ†æï¼‰
ğŸ”¸ ç”Ÿäº§ç¯å¢ƒï¼šç›‘æ§å¹³å° + è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå®æ—¶ç›‘æ§ï¼‰
ğŸ”¸ è¿ç»´ä¼˜åŒ–ï¼špt-query-digest + ä¸“ä¸šå·¥å…·ï¼ˆç³»ç»Ÿåˆ†æï¼‰

å¤æ‚åº¦è€ƒè™‘ï¼š
ğŸ“Œ ç®€å•é—®é¢˜ï¼šç”¨ç®€å•å·¥å…·
ğŸ“Œ å¤æ‚é—®é¢˜ï¼šç»„åˆå¤šç§å·¥å…·
ğŸ“Œ å›¢é˜ŸæŠ€èƒ½ï¼šé€‰æ‹©å›¢é˜Ÿèƒ½æŒæ¡çš„å·¥å…·
ğŸ“Œ æŠ•å…¥äº§å‡ºï¼šæƒè¡¡å·¥å…·æˆæœ¬ä¸æ”¶ç›Š
```

---

## 2. ğŸ“Š EXPLAINæ‰§è¡Œè®¡åˆ’åˆ†æ



### 2.1 EXPLAINå·¥å…·åŸºç¡€



**ğŸ’¡ ä»€ä¹ˆæ˜¯æ‰§è¡Œè®¡åˆ’**
```
æ‰§è¡Œè®¡åˆ’ï¼šæ•°æ®åº“ä¼˜åŒ–å™¨ä¸ºæŸ¥è¯¢é€‰æ‹©çš„å…·ä½“æ‰§è¡Œæ–¹æ¡ˆ

å½¢è±¡ç†è§£ï¼š
æ‰§è¡Œè®¡åˆ’ = å¯¼èˆªè·¯çº¿
- ä»Aåœ°åˆ°Båœ°æœ‰å¤šæ¡è·¯çº¿
- å¯¼èˆªé€‰æ‹©æœ€ä¼˜è·¯çº¿ï¼ˆæ—¶é—´æœ€çŸ­ã€è·¯å†µæœ€å¥½ï¼‰
- æ•°æ®åº“ä¼˜åŒ–å™¨é€‰æ‹©æœ€ä¼˜æŸ¥è¯¢æ–¹æ¡ˆ

EXPLAINçš„ä½œç”¨ï¼š
ğŸ”¸ å±•ç¤ºä¼˜åŒ–å™¨çš„æ‰§è¡Œæ–¹æ¡ˆ
ğŸ”¸ æ˜¾ç¤ºè¡¨çš„è®¿é—®æ–¹å¼
ğŸ”¸ æ­ç¤ºç´¢å¼•ä½¿ç”¨æƒ…å†µ
ğŸ”¸ ä¼°ç®—æŸ¥è¯¢æˆæœ¬
```

### 2.2 EXPLAINè¾“å‡ºæ ¼å¼



**ğŸ“‹ åŸºæœ¬è¯­æ³•**
```sql
-- åŸºç¡€EXPLAIN
EXPLAIN SELECT * FROM users WHERE age > 25;

-- è¯¦ç»†æ ¼å¼ï¼ˆMySQL 5.6+ï¼‰
EXPLAIN FORMAT=JSON SELECT * FROM users WHERE age > 25;

-- å¸¦æ‰§è¡Œç»Ÿè®¡ï¼ˆMySQL 8.0+ï¼‰
EXPLAIN ANALYZE SELECT * FROM users WHERE age > 25;
```

**ğŸ” æ‰§è¡Œè®¡åˆ’å­—æ®µè§£æ**

<details>
<summary><strong>ğŸ“– EXPLAINå­—æ®µè¯¦è§£</strong></summary>

| **å­—æ®µå** | **å«ä¹‰** | **é‡è¦å€¼** | **è¯´æ˜** |
|-----------|---------|-----------|---------|
| `id` | æŸ¥è¯¢åºåˆ—å· | æ•°å­— | **æ•°å­—è¶Šå¤§è¶Šå…ˆæ‰§è¡Œï¼Œç›¸åŒæ•°å­—ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ** |
| `select_type` | æŸ¥è¯¢ç±»å‹ | SIMPLE, PRIMARY, SUBQUERY | **æ ‡è¯†æŸ¥è¯¢çš„å¤æ‚ç¨‹åº¦** |
| `table` | æ¶‰åŠçš„è¡¨ | è¡¨å | å½“å‰è¡Œå¯¹åº”çš„è¡¨ |
| `type` | è®¿é—®ç±»å‹ | const, eq_ref, ref, range, index, ALL | **âš ï¸ æœ€é‡è¦å­—æ®µï¼Œå†³å®šæŸ¥è¯¢æ•ˆç‡** |
| `possible_keys` | å¯èƒ½ç”¨åˆ°çš„ç´¢å¼• | ç´¢å¼•ååˆ—è¡¨ | ä¼˜åŒ–å™¨è€ƒè™‘çš„ç´¢å¼• |
| `key` | å®é™…ä½¿ç”¨çš„ç´¢å¼• | ç´¢å¼•å | **å®é™…é€‰æ‹©çš„ç´¢å¼•** |
| `key_len` | ç´¢å¼•ä½¿ç”¨é•¿åº¦ | å­—èŠ‚æ•° | ä½¿ç”¨äº†ç´¢å¼•çš„å¤šå°‘éƒ¨åˆ† |
| `ref` | ç´¢å¼•åŒ¹é…æ¡ä»¶ | å¸¸æ•°æˆ–åˆ—å | ç´¢å¼•åŒ¹é…çš„å‚è€ƒå€¼ |
| `rows` | é¢„ä¼°æ£€æŸ¥è¡Œæ•° | æ•°å­— | **âš ï¸ ä¼°ç®—éœ€è¦æ£€æŸ¥çš„è¡Œæ•°ï¼Œè¶Šå°è¶Šå¥½** |
| `Extra` | é¢å¤–ä¿¡æ¯ | å„ç§æç¤º | **é‡è¦çš„æ‰§è¡Œç»†èŠ‚** |

</details>

### 2.3 typeå­—æ®µè¯¦è§£ï¼ˆæœ€å…³é”®ï¼‰



**â­ typeå­—æ®µæ˜¯æ€§èƒ½çš„æ ¸å¿ƒæŒ‡æ ‡**
```
æ€§èƒ½ä»å¥½åˆ°åæ’åºï¼š
const > eq_ref > ref > range > index > ALL

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ const   â† æœ€å¿«ï¼šå¸¸é‡æŸ¥è¯¢ï¼Œä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æŸ¥è¯¢           â”‚
â”‚ eq_ref  â† å¾ˆå¿«ï¼šå”¯ä¸€ç´¢å¼•æ‰«æï¼ŒJOINä¸­æ¯ä¸ªç»„åˆåªåŒ¹é…ä¸€è¡Œ â”‚ 
â”‚ ref     â† è¾ƒå¿«ï¼šéå”¯ä¸€ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå€¼çš„è¡Œ     â”‚
â”‚ range   â† ä¸€èˆ¬ï¼šç´¢å¼•èŒƒå›´æ‰«æï¼ŒWHEREä¸­æœ‰èŒƒå›´æ¡ä»¶       â”‚
â”‚ index   â† è¾ƒæ…¢ï¼šç´¢å¼•å…¨æ‰«æï¼Œæ¯”ALLå¿«ä½†ä»éœ€ä¼˜åŒ–        â”‚
â”‚ ALL     â† æœ€æ…¢ï¼šå…¨è¡¨æ‰«æï¼Œéœ€è¦ä¼˜åŒ–                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ” typeå®ä¾‹è§£æ**
```sql
-- constç±»å‹ï¼šæœ€å¿«çš„æŸ¥è¯¢
EXPLAIN SELECT * FROM users WHERE id = 123;
-- type: constï¼Œé€šè¿‡ä¸»é”®ç›´æ¥å®šä½ï¼Œåªæ£€æŸ¥1è¡Œ

-- eq_refç±»å‹ï¼šJOINä¸­çš„æœ€ä¼˜æƒ…å†µ  
EXPLAIN 
SELECT u.name, o.total 
FROM users u JOIN orders o ON u.id = o.user_id 
WHERE u.id = 123;
-- type: const(usersè¡¨), eq_ref(ordersè¡¨)

-- refç±»å‹ï¼šé€šè¿‡æ™®é€šç´¢å¼•æŸ¥è¯¢
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';
-- type: refï¼Œå¦‚æœemailæœ‰ç´¢å¼•ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…çš„è¡Œ

-- rangeç±»å‹ï¼šèŒƒå›´æŸ¥è¯¢
EXPLAIN SELECT * FROM orders WHERE order_date BETWEEN '2024-01-01' AND '2024-12-31';
-- type: rangeï¼Œä½¿ç”¨ç´¢å¼•æ‰«ææŒ‡å®šèŒƒå›´

-- ALLç±»å‹ï¼šéœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢
EXPLAIN SELECT * FROM users WHERE UPPER(name) = 'JOHN';
-- type: ALLï¼Œå‡½æ•°å¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æ
```

### 2.4 Extraå­—æ®µè§£è¯»



**ğŸš¨ éœ€è¦å…³æ³¨çš„Extraä¿¡æ¯**
```
å¥½çš„ä¿¡æ¯ï¼ˆä¼˜åŒ–æ•ˆæœå¥½ï¼‰ï¼š
âœ… Using indexï¼šåªä½¿ç”¨ç´¢å¼•å°±èƒ½è·å–æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ï¼ˆè¦†ç›–ç´¢å¼•ï¼‰
âœ… Using index conditionï¼šç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°
âœ… Using whereï¼šä½¿ç”¨WHEREæ¡ä»¶è¿‡æ»¤

è­¦å‘Šä¿¡æ¯ï¼ˆéœ€è¦ä¼˜åŒ–ï¼‰ï¼š
âš ï¸ Using filesortï¼šéœ€è¦æ’åºæ“ä½œï¼Œè€ƒè™‘æ·»åŠ ç´¢å¼•
âš ï¸ Using temporaryï¼šéœ€è¦ä¸´æ—¶è¡¨ï¼Œé€šå¸¸å‡ºç°åœ¨GROUP BYæˆ–DISTINCT
âš ï¸ Using join bufferï¼šJOINæ²¡æœ‰åˆé€‚çš„ç´¢å¼•ï¼Œä½¿ç”¨å†…å­˜ç¼“å†²

å±é™©ä¿¡æ¯ï¼ˆå¿…é¡»ä¼˜åŒ–ï¼‰ï¼š
âŒ Using where; Using join buffer (Block Nested Loop)ï¼šæœ€å·®çš„JOINæ–¹å¼
âŒ Range checked for each recordï¼šæ¯è¡Œéƒ½è¦æ£€æŸ¥èŒƒå›´ï¼Œæ€§èƒ½æå·®
```

**ğŸ’¡ ä¼˜åŒ–å»ºè®®å¯¹ç…§è¡¨**

| **Extraä¿¡æ¯** | **é—®é¢˜åŸå› ** | **ä¼˜åŒ–å»ºè®®** |
|--------------|-------------|-------------|
| `Using filesort` | ORDER BYæ— æ³•ä½¿ç”¨ç´¢å¼• | åœ¨ORDER BYå­—æ®µä¸Šå»ºç«‹ç´¢å¼• |
| `Using temporary` | GROUP BYæ— æ³•ä½¿ç”¨ç´¢å¼• | åœ¨GROUP BYå­—æ®µä¸Šå»ºç«‹ç´¢å¼• |
| `Using join buffer` | JOINç¼ºå°‘ç´¢å¼• | åœ¨JOINå­—æ®µä¸Šå»ºç«‹ç´¢å¼• |
| `Using where` | WHEREæ¡ä»¶åœ¨å¼•æ“å±‚è¿‡æ»¤ | è€ƒè™‘è¦†ç›–ç´¢å¼•ä¼˜åŒ– |

### 2.5 æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–æ¡ˆä¾‹



**ğŸ”§ å®é™…ä¼˜åŒ–ç¤ºä¾‹**
```sql
-- é—®é¢˜æŸ¥è¯¢ï¼šæŸ¥æ‰¾æŒ‡å®šåŸå¸‚çš„æ´»è·ƒç”¨æˆ·
SELECT u.name, u.email, u.phone
FROM users u 
WHERE u.city = 'Beijing' 
  AND u.status = 'active'
  AND u.last_login > '2024-01-01'
ORDER BY u.last_login DESC
LIMIT 10;

-- ä¼˜åŒ–å‰EXPLAINç»“æœ
+----+-------+-------+------+------+---------+-------+------+----------+-----------------------------+
| id | type  | table | key  | ref  | rows    | Extra                       |
+----+-------+-------+------+------+---------+-------+------+----------+-----------------------------+
|  1 | ALL   | u     | NULL | NULL | 1000000 | Using where; Using filesort |
+----+-------+-------+------+------+---------+-------+------+----------+-----------------------------+

é—®é¢˜åˆ†æï¼š
âŒ type=ALLï¼šå…¨è¡¨æ‰«æ100ä¸‡è¡Œ
âŒ key=NULLï¼šæ²¡æœ‰ä½¿ç”¨ç´¢å¼•  
âŒ Using filesortï¼šéœ€è¦å¤–éƒ¨æ’åº

-- æ·»åŠ å¤åˆç´¢å¼•
CREATE INDEX idx_users_city_status_login 
ON users(city, status, last_login);

-- ä¼˜åŒ–åEXPLAINç»“æœ
+----+-------+-------+------------------------+------+------+---------+
| id | type  | table | key                    | ref  | rows | Extra   |
+----+-------+-------+------------------------+------+------+---------+
|  1 | range | u     | idx_users_city_status_login | NULL | 50   | Using index condition |
+----+-------+-------+------------------------+------+------+---------+

ä¼˜åŒ–æ•ˆæœï¼š
âœ… type=rangeï¼šç´¢å¼•èŒƒå›´æ‰«æ
âœ… rows=50ï¼šåªæ£€æŸ¥50è¡Œï¼ˆå‡å°‘99.995%ï¼‰
âœ… æ— filesortï¼šç´¢å¼•æœ¬èº«æœ‰åºï¼Œæ— éœ€é¢å¤–æ’åº
```

---

## 3. âš¡ æ€§èƒ½åˆ†æå·¥å…·è¯¦è§£



### 3.1 SHOW PROFILEæ·±åº¦åˆ†æ



**ğŸ’¡ SHOW PROFILEæ˜¯ä»€ä¹ˆ**
```
SHOW PROFILEï¼šMySQLå†…ç½®çš„æŸ¥è¯¢æ€§èƒ½åˆ†æå·¥å…·

ä½œç”¨ï¼šè¯¦ç»†å±•ç¤ºSQLæ‰§è¡Œçš„æ¯ä¸ªé˜¶æ®µè€—æ—¶
å¥½å¤„ï¼šç²¾ç¡®å®šä½æ€§èƒ½ç“¶é¢ˆåœ¨å“ªä¸ªç¯èŠ‚

æ‰§è¡Œé˜¶æ®µåˆ†è§£ï¼š
æŸ¥è¯¢ â†’ è§£æ â†’ ä¼˜åŒ– â†’ æ‰§è¡Œ â†’ è¿”å›ç»“æœ
æ¯ä¸ªé˜¶æ®µéƒ½å¯èƒ½æˆä¸ºç“¶é¢ˆï¼
```

**ğŸ”§ ä½¿ç”¨æ–¹æ³•**
```sql
-- å¯ç”¨profilingåŠŸèƒ½
SET profiling = 1;

-- æ‰§è¡Œè¦åˆ†æçš„æŸ¥è¯¢
SELECT u.name, COUNT(o.id) as order_count
FROM users u 
LEFT JOIN orders o ON u.id = o.user_id 
GROUP BY u.id, u.name
HAVING order_count > 5;

-- æŸ¥çœ‹æŸ¥è¯¢åˆ—è¡¨
SHOW PROFILES;
+----------+----------+----------------------------------------+
| Query_ID | Duration | Query                                  |
+----------+----------+----------------------------------------+
|        1 | 2.15483  | SELECT u.name, COUNT(o.id)...         |
+----------+----------+----------------------------------------+

-- æŸ¥çœ‹è¯¦ç»†çš„æ‰§è¡Œé˜¶æ®µåˆ†æ
SHOW PROFILE FOR QUERY 1;
+----------------------+----------+
| Status               | Duration |
+----------------------+----------+
| starting             | 0.000087 |
| checking permissions | 0.000012 |
| Opening tables       | 0.000035 |
| init                 | 0.000042 |
| System lock          | 0.000015 |
| optimizing           | 0.000025 |
| statistics           | 0.000055 |
| preparing            | 0.000032 |
| executing            | 0.000008 |
| Sending data         | 2.154234 |  â† ä¸»è¦è€—æ—¶ï¼
| end                  | 0.000012 |
| query end            | 0.000008 |
| closing tables       | 0.000015 |
| freeing items        | 0.000023 |
| cleaning up          | 0.000018 |
+----------------------+----------+
```

**ğŸ“Š å…³é”®é˜¶æ®µè§£æ**
```
é‡è¦é˜¶æ®µåŠå…¶å«ä¹‰ï¼š

ğŸ”¸ statisticsï¼ˆç»Ÿè®¡ä¿¡æ¯æ”¶é›†ï¼‰
- è€—æ—¶è¾ƒé•¿ï¼šè¡¨ç»Ÿè®¡ä¿¡æ¯è¿‡æ—§ï¼Œéœ€è¦æ›´æ–°
- ä¼˜åŒ–ï¼šANALYZE TABLE table_name;

ğŸ”¸ preparingï¼ˆSQLè§£æå’Œå‡†å¤‡ï¼‰
- è€—æ—¶è¾ƒé•¿ï¼šSQLè¿‡äºå¤æ‚æˆ–å­˜å‚¨è¿‡ç¨‹å¤æ‚
- ä¼˜åŒ–ï¼šç®€åŒ–SQLï¼Œä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥

ğŸ”¸ Sending dataï¼ˆæ•°æ®ä¼ è¾“ï¼‰
- è€—æ—¶å¾ˆé•¿ï¼šé€šå¸¸æ˜¯ä¸»è¦ç“¶é¢ˆ
- åŸå› ï¼šè¿”å›æ•°æ®é‡å¤§ï¼Œæˆ–è€…WHEREæ¡ä»¶è¿‡æ»¤æ•ˆç‡ä½
- ä¼˜åŒ–ï¼šæ·»åŠ ç´¢å¼•ï¼Œä¼˜åŒ–WHEREæ¡ä»¶ï¼Œå‡å°‘è¿”å›å­—æ®µ

ğŸ”¸ Sorting resultï¼ˆç»“æœæ’åºï¼‰
- è€—æ—¶è¾ƒé•¿ï¼šORDER BYæ— æ³•ä½¿ç”¨ç´¢å¼•
- ä¼˜åŒ–ï¼šåœ¨æ’åºå­—æ®µä¸Šå»ºç«‹ç´¢å¼•

ğŸ”¸ Creating tmp tableï¼ˆåˆ›å»ºä¸´æ—¶è¡¨ï¼‰
- è€—æ—¶è¾ƒé•¿ï¼šGROUP BYæˆ–DISTINCTæ— æ³•ä½¿ç”¨ç´¢å¼•
- ä¼˜åŒ–ï¼šä¼˜åŒ–GROUP BYå­—æ®µçš„ç´¢å¼•
```

### 3.2 Performance Schemaè¯¦è§£



**ğŸ¯ Performance Schemaæ¦‚è¿°**
```
Performance Schemaï¼šMySQLçš„æ€§èƒ½ç›‘æ§å’Œè¯Šæ–­å¼•æ“

æ ¸å¿ƒç‰¹ç‚¹ï¼š
ğŸ”¸ å®æ—¶ç›‘æ§ï¼šæ— éœ€é¢å¤–é…ç½®ï¼ŒæŒç»­æ”¶é›†æ€§èƒ½æ•°æ®
ğŸ”¸ ä½å¼€é”€ï¼šå¯¹ç”Ÿäº§ç¯å¢ƒå½±å“å¾ˆå°ï¼ˆ<5%ï¼‰
ğŸ”¸ è¯¦ç»†ä¿¡æ¯ï¼šSQLçº§åˆ«ã€è¡¨çº§åˆ«ã€é”çº§åˆ«ç›‘æ§
ğŸ”¸ å†å²è®°å½•ï¼šä¿å­˜æ€§èƒ½æ•°æ®çš„å†å²è¶‹åŠ¿

ä¸æ…¢æŸ¥è¯¢æ—¥å¿—å¯¹æ¯”ï¼š
æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šåªè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„æŸ¥è¯¢
Performance Schemaï¼šè®°å½•æ‰€æœ‰æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯
```

**ğŸ“Š æ ¸å¿ƒç›‘æ§è¡¨**
```sql
-- 1. æŸ¥çœ‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¯­å¥
SELECT 
    sql_text,
    current_schema,
    state,
    time
FROM performance_schema.processlist 
WHERE state != 'Sleep';

-- 2. æŸ¥çœ‹å†å²æ‰§è¡Œçš„è¯­å¥ç»Ÿè®¡
SELECT 
    DIGEST_TEXT as sql_pattern,
    COUNT_STAR as exec_count,
    AVG_TIMER_WAIT/1000000000 as avg_time_sec,
    MAX_TIMER_WAIT/1000000000 as max_time_sec,
    SUM_TIMER_WAIT/1000000000 as total_time_sec
FROM performance_schema.events_statements_summary_by_digest 
ORDER BY SUM_TIMER_WAIT DESC 
LIMIT 10;

-- 3. æŸ¥çœ‹è¡¨è®¿é—®ç»Ÿè®¡
SELECT 
    OBJECT_SCHEMA,
    OBJECT_NAME,
    COUNT_READ,
    COUNT_WRITE,
    COUNT_FETCH,
    SUM_TIMER_WAIT/1000000000 as total_time_sec
FROM performance_schema.table_io_waits_summary_by_table 
ORDER BY SUM_TIMER_WAIT DESC
LIMIT 10;
```

**ğŸ’» å®ç”¨æŸ¥è¯¢æ¨¡æ¿**
```sql
-- æ‰¾å‡ºæœ€è€—æ—¶çš„æŸ¥è¯¢ç±»å‹
SELECT 
    SUBSTR(DIGEST_TEXT, 1, 100) AS query_sample,
    COUNT_STAR AS exec_count,
    ROUND(AVG_TIMER_WAIT/1000000000, 2) AS avg_sec,
    ROUND(SUM_TIMER_WAIT/1000000000, 2) AS total_sec,
    ROUND(SUM_TIMER_WAIT * 100 / (
        SELECT SUM(SUM_TIMER_WAIT) 
        FROM performance_schema.events_statements_summary_by_digest
    ), 2) AS pct_total_time
FROM performance_schema.events_statements_summary_by_digest 
ORDER BY SUM_TIMER_WAIT DESC 
LIMIT 5;

-- æ‰¾å‡ºè®¿é—®æœ€é¢‘ç¹çš„è¡¨
SELECT 
    OBJECT_SCHEMA AS db_name,
    OBJECT_NAME AS table_name,
    COUNT_READ + COUNT_WRITE AS total_io,
    COUNT_READ,
    COUNT_WRITE,
    ROUND(SUM_TIMER_WAIT/1000000000, 2) AS total_time_sec
FROM performance_schema.table_io_waits_summary_by_table
WHERE OBJECT_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema')
ORDER BY total_io DESC
LIMIT 10;
```

### 3.3 ä¼˜åŒ–å™¨è·Ÿè¸ªï¼ˆOptimizer Traceï¼‰



**ğŸ”¬ æ·±åº¦åˆ†æå·¥å…·**
```
Optimizer Traceï¼šæŸ¥çœ‹ä¼˜åŒ–å™¨çš„å†³ç­–è¿‡ç¨‹

å¯ç”¨è·Ÿè¸ªï¼š
SET optimizer_trace = "enabled=on";

æ‰§è¡ŒæŸ¥è¯¢åæŸ¥çœ‹è·Ÿè¸ªä¿¡æ¯ï¼š
SELECT * FROM information_schema.OPTIMIZER_TRACE;

åº”ç”¨åœºæ™¯ï¼š
ğŸ”¸ ç†è§£ä¸ºä»€ä¹ˆä¼˜åŒ–å™¨é€‰æ‹©äº†æŸä¸ªæ‰§è¡Œè®¡åˆ’
ğŸ”¸ è°ƒè¯•å¤æ‚æŸ¥è¯¢çš„ä¼˜åŒ–é—®é¢˜
ğŸ”¸ éªŒè¯ç´¢å¼•è®¾è®¡æ˜¯å¦åˆç†
```

**ğŸ“ è·Ÿè¸ªä¿¡æ¯è§£è¯»**
```json
{
  "steps": [
    {
      "join_preparation": {
        "select#": 1,
        "steps": [
          {
            "transformations": [
              "equality_propagation",
              "constant_propagation", 
              "trivial_condition_removal"
            ]
          }
        ]
      }
    },
    {
      "join_optimization": {
        "select#": 1,
        "steps": [
          {
            "condition_processing": {
              "condition": "WHERE",
              "original_condition": "users.age > 25 AND users.city = 'Beijing'",
              "steps": [
                {
                  "transformation": "equality_propagation",
                  "resulting_condition": "users.age > 25 AND users.city = 'Beijing'"
                }
              ]
            }
          }
        ]
      }
    }
  ]
}

å…³é”®ä¿¡æ¯ï¼š
ğŸ”¸ condition_processingï¼šWHEREæ¡ä»¶çš„å¤„ç†è¿‡ç¨‹
ğŸ”¸ range_analysisï¼šèŒƒå›´æŸ¥è¯¢åˆ†æ
ğŸ”¸ index_mergeï¼šç´¢å¼•åˆå¹¶åˆ†æ
ğŸ”¸ considered_execution_plansï¼šè€ƒè™‘çš„æ‰§è¡Œè®¡åˆ’
ğŸ”¸ best_access_pathï¼šé€‰æ‹©çš„æœ€ä½³è®¿é—®è·¯å¾„
```

---

## 4. ğŸ“ˆ æ…¢æŸ¥è¯¢åˆ†æç³»ç»Ÿ



### 4.1 æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®



**âš™ï¸ æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ä»€ä¹ˆ**
```
æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šMySQLè‡ªåŠ¨è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„æŸ¥è¯¢

æ ¸å¿ƒä»·å€¼ï¼š
ğŸ”¸ è‡ªåŠ¨æ”¶é›†ï¼šæ— éœ€äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨è®°å½•æ…¢æŸ¥è¯¢
ğŸ”¸ ç”Ÿäº§å‹å¥½ï¼šå¯¹æ€§èƒ½å½±å“æå°
ğŸ”¸ è¯¦ç»†ä¿¡æ¯ï¼šè®°å½•æŸ¥è¯¢è¯­å¥ã€æ‰§è¡Œæ—¶é—´ã€é”ç­‰å¾…æ—¶é—´ç­‰
ğŸ”¸ å†å²è¿½æº¯ï¼šå¯ä»¥åˆ†æä¸€æ®µæ—¶é—´å†…çš„æ€§èƒ½è¶‹åŠ¿

é…ç½®è¦ç‚¹ï¼š
ğŸ“Œ è®¾ç½®åˆç†çš„é˜ˆå€¼ï¼šä¸èƒ½å¤ªå°ï¼ˆè¯¯æŠ¥ï¼‰ï¼Œä¸èƒ½å¤ªå¤§ï¼ˆæ¼æŠ¥ï¼‰
ğŸ“Œ é€‰æ‹©åˆé€‚çš„è®°å½•ä½ç½®ï¼šæ–‡ä»¶æˆ–è¡¨
ğŸ“Œ å®šæœŸæ¸…ç†ï¼šé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§
```

**ğŸ”§ é…ç½®æ–¹æ³•**
```sql
-- æŸ¥çœ‹å½“å‰æ…¢æŸ¥è¯¢é…ç½®
SHOW VARIABLES LIKE 'slow_query%';
SHOW VARIABLES LIKE 'long_query_time';

-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆåŠ¨æ€é…ç½®ï¼‰
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL slow_query_log_file = '/var/log/mysql/slow.log';
SET GLOBAL long_query_time = 2;  -- è¶…è¿‡2ç§’çš„æŸ¥è¯¢è®°å½•

-- è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ï¼ˆå¯é€‰ï¼‰
SET GLOBAL log_queries_not_using_indexes = 'ON';

-- é…ç½®æ–‡ä»¶æ–¹å¼ï¼ˆmy.cnfï¼‰
[mysqld]
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1
min_examined_row_limit = 1000  # è‡³å°‘æ£€æŸ¥1000è¡Œæ‰è®°å½•
```

**ğŸ“‹ æ…¢æŸ¥è¯¢æ—¥å¿—æ ¼å¼è§£è¯»**
```
# Time: 2024-01-15T10:30:45.123456Z

# User@Host: app_user[app_user] @ [192.168.1.100]

# Thread_id: 12345  Schema: ecommerce  QC_hit: No

# Query_time: 5.234567  Lock_time: 0.000123  Rows_sent: 250  Rows_examined: 1000000

# Rows_affected: 0  Bytes_sent: 15420

SET timestamp=1705315845;
SELECT u.name, u.email, COUNT(o.id) as order_count
FROM users u LEFT JOIN orders o ON u.id = o.user_id 
WHERE u.city = 'Beijing' AND u.status = 'active'
GROUP BY u.id ORDER BY order_count DESC LIMIT 250;

å…³é”®ä¿¡æ¯è§£è¯»ï¼š
ğŸ”¸ Query_time: 5.23ç§’ï¼šæ€»æ‰§è¡Œæ—¶é—´
ğŸ”¸ Lock_time: 0.0001ç§’ï¼šé”ç­‰å¾…æ—¶é—´  
ğŸ”¸ Rows_examined: 100ä¸‡ï¼šæ£€æŸ¥äº†100ä¸‡è¡Œ
ğŸ”¸ Rows_sent: 250ï¼šæœ€ç»ˆè¿”å›250è¡Œ
ğŸ”¸ æ•ˆç‡æ¯”ï¼š250/1000000 = 0.025%ï¼ˆæ•ˆç‡æä½ï¼ï¼‰
```

### 4.2 pt-query-digestå·¥å…·



**ğŸ› ï¸ ä¸“ä¸šæ…¢æŸ¥è¯¢åˆ†æå·¥å…·**
```
pt-query-digestï¼šPerconaå…¬å¸å¼€å‘çš„æŸ¥è¯¢åˆ†æå·¥å…·

æ ¸å¿ƒåŠŸèƒ½ï¼š
ğŸ”¸ è§£ææ…¢æŸ¥è¯¢æ—¥å¿—
ğŸ”¸ æŒ‰æŸ¥è¯¢æ¨¡å¼åˆ†ç»„ç»Ÿè®¡
ğŸ”¸ è®¡ç®—å„ç§æ€§èƒ½æŒ‡æ ‡
ğŸ”¸ ç”Ÿæˆè¯¦ç»†çš„åˆ†ææŠ¥å‘Š

å®‰è£…ä½¿ç”¨ï¼š
# CentOS/RHEL

yum install percona-toolkit

# Ubuntu/Debian  

apt-get install percona-toolkit

# åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—

pt-query-digest /var/log/mysql/slow.log > slow_query_report.txt
```

**ğŸ“Š åˆ†ææŠ¥å‘Šè§£è¯»**
```
# æŠ¥å‘Šå¤´éƒ¨ï¼šæ•´ä½“ç»Ÿè®¡

# Overall: 2.5k total, 156 unique, 0.35 QPS, 0.87x concurrency ___________

# Time range: 2024-01-01 to 2024-01-07

# Attribute          total     min     max     avg     95%  stddev  median

# ============     ======= ======= ======= ======= ======= ======= =======

# Exec time          2165s     1s    45s     5s     8s      3s      4s

# Lock time           156s     0s     2s    0.06s   0.1s   0.2s    0.01s

# Rows sent          2.5k       0   1.2k      1   2.5      15       0

# Rows examine      25.6M       0  2.1M  10.4k  50.2k  115.7k    2.5k


è§£è¯»è¦ç‚¹ï¼š
ğŸ”¸ 2.5k totalï¼šæ€»å…±2500ä¸ªæ…¢æŸ¥è¯¢
ğŸ”¸ 156 uniqueï¼š156ç§ä¸åŒçš„æŸ¥è¯¢æ¨¡å¼
ğŸ”¸ Exec time avg 5sï¼šå¹³å‡æ‰§è¡Œæ—¶é—´5ç§’
ğŸ”¸ 95% 8sï¼š95%çš„æŸ¥è¯¢åœ¨8ç§’å†…å®Œæˆ
```

**ğŸ¯ TopæŸ¥è¯¢åˆ†æ**
```
# Query 1: 0.18 QPS, 1.34x concurrency, ID 0xF1D1B4B7E5F... 

# This item is included in the report because it matches --limit.

# Databases: ecommerce

# Hosts: app-server-01

# Query_time distribution

#   1us-10us  :                                                               

#   10us-100us:                                                               

#   100us-1ms :                                                               

#   1ms-10ms  :                                                               

#   10ms-100ms: ################################################################

#   100ms-1s  : ################################

#   1s-10s+   : ################

# Tables

#    SHOW TABLE STATUS FROM `ecommerce` LIKE 'users'\G

#    SHOW CREATE TABLE `ecommerce`.`users`\G

#    SHOW TABLE STATUS FROM `ecommerce` LIKE 'orders'\G  

#    SHOW CREATE TABLE `ecommerce`.`orders`\G


SELECT u.name, u.email, COUNT(o.id) as order_count
FROM users u LEFT JOIN orders o ON u.id = o.user_id 
WHERE u.city = ? AND u.status = ?
GROUP BY u.id ORDER BY order_count DESC LIMIT ?;

åˆ†æç»“æœï¼š
ğŸ”¸ æ‰§è¡Œé¢‘ç‡ï¼šæ¯ç§’0.18æ¬¡ï¼Œæ¶ˆè€—134%çš„CPUæ—¶é—´
ğŸ”¸ æ—¶é—´åˆ†å¸ƒï¼šå¤§éƒ¨åˆ†åœ¨100ms-10sä¹‹é—´
ğŸ”¸ ä¼˜åŒ–å»ºè®®ï¼šæ£€æŸ¥JOINå­—æ®µç´¢å¼•ï¼Œä¼˜åŒ–GROUP BY
```

### 4.3 Performance Schemaé«˜çº§åº”ç”¨



**ğŸª statementåˆ†æ**
```sql
-- æŸ¥æ‰¾æœ€è€—æ—¶çš„æŸ¥è¯¢æ¨¡å¼
SELECT 
    DIGEST_TEXT,
    COUNT_STAR as exec_count,
    ROUND(AVG_TIMER_WAIT/1000000000, 2) as avg_time,
    ROUND(MAX_TIMER_WAIT/1000000000, 2) as max_time,
    ROUND(SUM_TIMER_WAIT/1000000000, 2) as total_time,
    ROUND(AVG_ROWS_EXAMINED/AVG_ROWS_SENT, 0) as efficiency_ratio
FROM performance_schema.events_statements_summary_by_digest
WHERE SCHEMA_NAME = 'ecommerce'
ORDER BY SUM_TIMER_WAIT DESC
LIMIT 5;

ç»“æœåˆ†æï¼š
+--------------------------------------------------+------------+----------+----------+------------+----------------+
| DIGEST_TEXT                                      | exec_count | avg_time | max_time | total_time | efficiency_ratio|
+--------------------------------------------------+------------+----------+----------+------------+----------------+
| SELECT * FROM `users` WHERE `city` = ?          |       1250 |     3.45 |    15.67 |    4312.50 |           2500 |
| SELECT COUNT ( * ) FROM `orders` WHERE ...      |        890 |     2.12 |     8.90 |    1886.80 |              1 |
+--------------------------------------------------+------------+----------+----------+------------+----------------+

å…³é”®æŒ‡æ ‡ï¼š
ğŸ”¸ efficiency_ratio > 1000ï¼šæŸ¥è¯¢æ•ˆç‡å¾ˆä½ï¼Œéœ€è¦ä¼˜åŒ–
ğŸ”¸ max_timeè¿‡å¤§ï¼šå¯èƒ½æœ‰é”ç­‰å¾…æˆ–æ•°æ®å€¾æ–œé—®é¢˜  
ğŸ”¸ exec_countå¾ˆé«˜ï¼šé«˜é¢‘æŸ¥è¯¢ï¼Œä¼˜åŒ–æ”¶ç›Šå¤§
```

**ğŸ”„ é”ç­‰å¾…åˆ†æ**
```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ
SELECT 
    r.trx_id as blocking_trx_id,
    r.trx_mysql_thread_id as blocking_thread,
    CONCAT(r.trx_query) as blocking_query,
    b.trx_id as blocked_trx_id,
    b.trx_mysql_thread_id as blocked_thread,
    CONCAT(b.trx_query) as blocked_query,
    bl.lock_mode,
    bl.lock_type,
    bl.lock_table
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocked_trx_id
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.blocking_trx_id  
INNER JOIN information_schema.innodb_locks bl ON bl.lock_trx_id = w.blocking_trx_id;

-- æŸ¥çœ‹è¡¨é”ç»Ÿè®¡
SELECT 
    OBJECT_SCHEMA,
    OBJECT_NAME, 
    SUM_TIMER_WAIT/1000000000 as total_wait_sec,
    COUNT_WRITE_LOCK,
    COUNT_READ_LOCK
FROM performance_schema.table_lock_waits_summary_by_table
WHERE OBJECT_SCHEMA = 'ecommerce'
ORDER BY SUM_TIMER_WAIT DESC;
```

---

## 5. ğŸ¢ ç¬¬ä¸‰æ–¹è°ƒä¼˜å·¥å…·



### 5.1 MySQL Workbench Performance Dashboard



**ğŸ›ï¸ å›¾å½¢åŒ–æ€§èƒ½ç›‘æ§**
```
MySQL Workbenchæ€§èƒ½ä»ªè¡¨æ¿ï¼š

æ ¸å¿ƒåŠŸèƒ½ï¼š
ğŸ”¸ å®æ—¶æ€§èƒ½ç›‘æ§å›¾è¡¨
ğŸ”¸ æ…¢æŸ¥è¯¢å¯è§†åŒ–åˆ†æ
ğŸ”¸ æœåŠ¡å™¨çŠ¶æ€ç›‘æ§
ğŸ”¸ æ‰§è¡Œè®¡åˆ’å›¾å½¢åŒ–æ˜¾ç¤º

ä½¿ç”¨åœºæ™¯ï¼š
âœ… å¼€å‘æµ‹è¯•ç¯å¢ƒè°ƒä¼˜
âœ… å¿«é€Ÿé—®é¢˜å®šä½
âœ… æ€§èƒ½è¶‹åŠ¿åˆ†æ
âœ… å›¢é˜Ÿåä½œåˆ†æ

è¿æ¥ç›‘æ§ï¼š
Server â†’ Performance Dashboard â†’ Real-time Monitoring
```

**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```
è¿æ¥ç›‘æ§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Connections: 145/200    Thread Cache: 85%      â”‚
â”‚ Active: 12             Aborted: 2%             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æŸ¥è¯¢ç›‘æ§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QPS: 1,250    Slow Queries: 15/hour            â”‚
â”‚ SELECT: 65%   INSERT: 20%   UPDATE: 10%        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èµ„æºç›‘æ§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CPU: 45%              Memory: 8.5GB/16GB       â”‚
â”‚ InnoDB Buffer: 85%    Query Cache: 35%         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ä¸“ä¸šè°ƒä¼˜å·¥å…·



#### ğŸ”§ **MySQLTunerè„šæœ¬**



**ğŸ’¡ è‡ªåŠ¨åŒ–é…ç½®å»ºè®®å·¥å…·**
```bash
# ä¸‹è½½å’Œè¿è¡ŒMySQLTuner

wget http://mysqltuner.pl/ -O mysqltuner.pl
perl mysqltuner.pl

# è¿è¡Œè¾“å‡ºç¤ºä¾‹

>>  MySQLTuner 1.7.21 - Major Hayden <major@mhtx.net>
>>  Bug reports, feature requests, and downloads at http://mysqltuner.pl/
>>  Run with '--help' for additional options and output filtering

[--] Skipped version check for MySQLTuner script
[OK] Currently running supported MySQL version 8.0.28
[OK] Operating on 64-bit architecture

-------- Log file Recommendations ------------------------------------------------------------------
[--] Log file: /var/log/mysql/error.log(146K)
[OK] Log file /var/log/mysql/error.log exists
[OK] Log file /var/log/mysql/error.log is readable.
[OK] Log file /var/log/mysql/error.log is not empty
[OK] Log file /var/log/mysql/error.log is smaller than 32 Mb
[OK] Log file /var/log/mysql/error.log doesn't contain "ERROR" lines

-------- Storage Engine Statistics -----------------------------------------------------------------
[--] Status: +ARCHIVE +BLACKHOLE +CSV +FEDERATED +InnoDB +MEMORY +MRG_MYISAM +MyISAM +PERFORMANCE_SCHEMA 
[--] Data in InnoDB tables: 2.1G (Tables: 45)
[OK] InnoDB is enabled.
[OK] InnoDB File-per-table is activated

-------- Performance Metrics ----------------------------------------------------------------------
[--] Up for: 2d 5h 32m 18s (2M q [11.574 qps], 15K conn, TX: 4G, RX: 890M)
[--] Reads / Writes: 78% / 22%
[--] Binary logging is disabled
[--] Physical Memory     : 16.0G
[--] Max MySQL memory    : 8.2G
[--] Other process memory: 1.8G
[--] Total buffers: 2.1G global + 18.2M per thread (151 max threads)
[OK] Maximum reached memory usage: 8.2G (51.25% of installed RAM)
[!!] Slow queries: 5% (156K/2M)  â† æ…¢æŸ¥è¯¢æ¯”ä¾‹è¿‡é«˜ï¼

å»ºè®®è¾“å‡ºï¼š
Variables to adjust:
  long_query_time (<= 1)           # è°ƒæ•´æ…¢æŸ¥è¯¢é˜ˆå€¼
  innodb_buffer_pool_size (>= 3G)  # å¢åŠ ç¼“å†²æ± å¤§å°
  query_cache_size (= 0)           # ç¦ç”¨æŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL 8.0å·²åºŸå¼ƒï¼‰
```

#### ğŸ“Š **Percona Monitoring and Management (PMM)**



**ğŸŒŸ ä¼ä¸šçº§ç›‘æ§å¹³å°**
```
PMMæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚ â†’ â”‚  PMM Client  â”‚ â†’ â”‚  PMM Server  â”‚
â”‚   æœåŠ¡å™¨     â”‚    â”‚   (Agent)    â”‚    â”‚  (Dashboard) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¸å¿ƒç»„ä»¶ï¼š
ğŸ”¸ PMM Clientï¼šéƒ¨ç½²åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œæ”¶é›†ç›‘æ§æ•°æ®
ğŸ”¸ PMM Serverï¼šé›†ä¸­å±•ç¤ºå’Œåˆ†æï¼ŒåŸºäºGrafana + Prometheus
ğŸ”¸ QAN (Query Analytics)ï¼šä¸“ä¸šçš„æŸ¥è¯¢åˆ†ææ¨¡å—

ä¼˜åŠ¿ç‰¹ç‚¹ï¼š
âœ… ä¸“ä¸šï¼šä¸“ä¸ºMySQLè®¾è®¡çš„ç›‘æ§æ–¹æ¡ˆ
âœ… å…è´¹ï¼šå¼€æºå·¥å…·ï¼Œæ— è®¸å¯è´¹ç”¨
âœ… å…¨é¢ï¼šè¦†ç›–ç³»ç»Ÿã€æ•°æ®åº“ã€æŸ¥è¯¢å„å±‚é¢
âœ… å®æ—¶ï¼šç§’çº§ç›‘æ§ï¼Œå¿«é€Ÿå‘ç°é—®é¢˜
```

**ğŸ¯ PMMéƒ¨ç½²ç¤ºä¾‹**
```bash
# 1. éƒ¨ç½²PMM Serverï¼ˆDockeræ–¹å¼ï¼‰

docker run -d \
  -p 443:443 \
  --volumes-from pmm-data \
  --name pmm-server \
  --restart always \
  percona/pmm-server:latest

# 2. åœ¨æ•°æ®åº“æœåŠ¡å™¨å®‰è£…PMM Client

wget https://repo.percona.com/apt/percona-release_latest.generic_all.deb
sudo dpkg -i percona-release_latest.generic_all.deb
sudo apt-get update
sudo apt-get install pmm2-client

# 3. é…ç½®ç›‘æ§

pmm-admin config --server-insecure-tls --server-url=https://admin:admin@PMM_SERVER_IP
pmm-admin add mysql --username=monitor_user --password=monitor_pass --query-source=perfschema mysql_main

# 4. éªŒè¯ç›‘æ§çŠ¶æ€

pmm-admin status
```

### 5.3 äº‘å¹³å°è°ƒä¼˜å·¥å…·



**â˜ï¸ äº‘å¹³å°é›†æˆæ–¹æ¡ˆ**

<details>
<summary><strong>ğŸ“Š ä¸»æµäº‘å¹³å°å¯¹æ¯”</strong></summary>

| **äº‘å¹³å°** | **å·¥å…·åç§°** | **æ ¸å¿ƒåŠŸèƒ½** | **ç‰¹è‰²ä¼˜åŠ¿** |
|-----------|-------------|-------------|-------------|
| **AWS** | `Performance Insights` | æ•°æ®åº“æ€§èƒ½ç›‘æ§ | æœºå™¨å­¦ä¹ å¼‚å¸¸æ£€æµ‹ |
| **é˜¿é‡Œäº‘** | `DASæ•°æ®åº“è‡ªæ²»æœåŠ¡` | æ™ºèƒ½è¯Šæ–­ä¼˜åŒ– | è‡ªåŠ¨SQLä¼˜åŒ–å»ºè®® |
| **è…¾è®¯äº‘** | `DBbrain` | æ•°æ®åº“æ™ºèƒ½ç®¡å®¶ | 7x24å°æ—¶æ™ºèƒ½å·¡æ£€ |
| **åä¸ºäº‘** | `DASæ•°æ®ç®¡ç†æœåŠ¡` | æ€§èƒ½ç›‘æ§è¯Šæ–­ | ä¸€ç«™å¼æ•°æ®åº“ç®¡ç† |

</details>

**ğŸ¯ é˜¿é‡Œäº‘DASå®æˆ˜**
```
DASï¼ˆDatabase Autonomy Serviceï¼‰æ ¸å¿ƒåŠŸèƒ½ï¼š

1ï¸âƒ£ SQLæ´å¯Ÿï¼š
- å®æ—¶SQLæ€§èƒ½ç›‘æ§
- è‡ªåŠ¨è¯†åˆ«å¼‚å¸¸SQL
- æä¾›å…·ä½“ä¼˜åŒ–å»ºè®®

2ï¸âƒ£ è‡ªæ²»ä¼˜åŒ–ï¼š
- è‡ªåŠ¨åˆ›å»ºç´¢å¼•å»ºè®®
- SQLé‡å†™å»ºè®®
- å‚æ•°é…ç½®å»ºè®®

3ï¸âƒ£ æ™ºèƒ½è¯Šæ–­ï¼š
- å®ä¾‹å¥åº·å·¡æ£€
- æ€§èƒ½è¶‹åŠ¿åˆ†æ
- å¼‚å¸¸å‘Šè­¦é€šçŸ¥

ä½¿ç”¨åœºæ™¯ï¼š
âœ… äº‘ä¸ŠRDSå®ä¾‹çš„æ€§èƒ½ä¼˜åŒ–
âœ… ç¼ºå°‘ä¸“ä¸šDBAçš„ä¸­å°ä¼ä¸š
âœ… éœ€è¦7x24ç›‘æ§çš„ä¸šåŠ¡ç³»ç»Ÿ
```

---

## 6. ğŸ¤– è‡ªåŠ¨åŒ–è°ƒä¼˜å¹³å°



### 6.1 AIé©±åŠ¨è°ƒä¼˜æ¦‚è¿°



**ğŸ§  äººå·¥æ™ºèƒ½åœ¨SQLè°ƒä¼˜ä¸­çš„åº”ç”¨**
```
ä¼ ç»Ÿè°ƒä¼˜ vs AIè°ƒä¼˜ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼š
ğŸ‘¨â€ğŸ’» äººå·¥åˆ†æ â†’ ğŸ“Š æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ â†’ ğŸ”§ æ‰‹åŠ¨ä¼˜åŒ– â†’ ğŸ“ˆ æ•ˆæœéªŒè¯
ç‰¹ç‚¹ï¼šä¾èµ–ä¸“å®¶ç»éªŒï¼Œå¤„ç†èƒ½åŠ›æœ‰é™ï¼Œæ— æ³•è¦†ç›–æ‰€æœ‰åœºæ™¯

AIé©±åŠ¨æ–¹å¼ï¼š
ğŸ¤– è‡ªåŠ¨æ”¶é›† â†’ ğŸ“Š æœºå™¨å­¦ä¹  â†’ ğŸ”§ æ™ºèƒ½å»ºè®® â†’ ğŸ“ˆ è‡ªåŠ¨éªŒè¯
ç‰¹ç‚¹ï¼šå¤§è§„æ¨¡å¤„ç†ï¼ŒæŒç»­å­¦ä¹ ï¼Œ24å°æ—¶ç›‘æ§

AIä¼˜åŠ¿ï¼š
ğŸ”¸ æ¨¡å¼è¯†åˆ«ï¼šä»æµ·é‡æŸ¥è¯¢ä¸­è¯†åˆ«æ€§èƒ½æ¨¡å¼
ğŸ”¸ é¢„æµ‹èƒ½åŠ›ï¼šé¢„æµ‹æŸ¥è¯¢æ€§èƒ½å˜åŒ–è¶‹åŠ¿
ğŸ”¸ è‡ªåŠ¨åŒ–ï¼šå‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜æ•ˆç‡
ğŸ”¸ æŒç»­ä¼˜åŒ–ï¼šæ ¹æ®æ•ˆæœåé¦ˆæŒç»­æ”¹è¿›
```

### 6.2 è‡ªåŠ¨ç´¢å¼•å»ºè®®ç³»ç»Ÿ



**ğŸ¯ æ™ºèƒ½ç´¢å¼•æ¨èåŸç†**
```
ç´¢å¼•æ¨èç®—æ³•ï¼š

æ­¥éª¤1ï¼šæŸ¥è¯¢å·¥ä½œè´Ÿè½½æ”¶é›†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ”¶é›†æœŸé—´ï¼ˆå¦‚7å¤©ï¼‰å†…çš„æ‰€æœ‰æŸ¥è¯¢       â”‚
â”‚ - SQLè¯­å¥åŠå…¶æ‰§è¡Œé¢‘æ¬¡              â”‚
â”‚ - æŸ¥è¯¢æ¡ä»¶å’ŒJOINå…³ç³»               â”‚  
â”‚ - å½“å‰ç´¢å¼•ä½¿ç”¨æƒ…å†µ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤2ï¼šå€™é€‰ç´¢å¼•ç”Ÿæˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸºäºæŸ¥è¯¢æ¨¡å¼ç”Ÿæˆå€™é€‰ç´¢å¼•            â”‚
â”‚ - WHEREæ¡ä»¶å­—æ®µç»„åˆ                â”‚
â”‚ - ORDER BYå­—æ®µ                     â”‚
â”‚ - JOINå­—æ®µ                         â”‚
â”‚ - GROUP BYå­—æ®µ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤3ï¼šæˆæœ¬æ•ˆç›Šåˆ†æ  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯„ä¼°æ¯ä¸ªå€™é€‰ç´¢å¼•çš„ä»·å€¼              â”‚
â”‚ - é¢„æµ‹æŸ¥è¯¢æ€§èƒ½æå‡å¹…åº¦              â”‚
â”‚ - è®¡ç®—ç´¢å¼•ç»´æŠ¤æˆæœ¬                 â”‚
â”‚ - å­˜å‚¨ç©ºé—´å ç”¨è¯„ä¼°                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤4ï¼šæ¨èæœ€ä¼˜æ–¹æ¡ˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰æ‹©æ”¶ç›Šæœ€å¤§çš„ç´¢å¼•ç»„åˆ              â”‚
â”‚ - é¿å…å†—ä½™ç´¢å¼•                     â”‚
â”‚ - å¹³è¡¡æŸ¥è¯¢æ€§èƒ½å’Œå†™å…¥æ€§èƒ½            â”‚
â”‚ - æä¾›å…·ä½“çš„CREATE INDEXè¯­å¥       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ è‡ªåŠ¨ç´¢å¼•å»ºè®®å®ç°**
```python
class AutoIndexAdvisor:
    def __init__(self, db_connection):
        self.db = db_connection
        self.query_log = []
        self.current_indexes = {}
    
    def collect_workload(self, days=7):
        """æ”¶é›†æŸ¥è¯¢å·¥ä½œè´Ÿè½½"""
        sql = f"""
        SELECT 
            DIGEST_TEXT,
            COUNT_STAR as frequency,
            AVG_TIMER_WAIT/1000000000 as avg_time_sec
        FROM performance_schema.events_statements_summary_by_digest
        WHERE FIRST_SEEN >= DATE_SUB(NOW(), INTERVAL {days} DAY)
        ORDER BY COUNT_STAR * AVG_TIMER_WAIT DESC
        """
        
        self.query_log = self.db.execute(sql).fetchall()
        return self.query_log
    
    def generate_index_candidates(self):
        """ç”Ÿæˆå€™é€‰ç´¢å¼•"""
        candidates = []
        
        for query in self.query_log:
            sql_text = query['DIGEST_TEXT']
#            # è§£æWHEREæ¡ä»¶
            where_columns = self.extract_where_columns(sql_text)
#            # è§£æORDER BY
            order_columns = self.extract_order_columns(sql_text)
#            # è§£æJOINæ¡ä»¶
            join_columns = self.extract_join_columns(sql_text)
            
#            # ç”Ÿæˆå¤åˆç´¢å¼•å»ºè®®
            if where_columns and order_columns:
                candidate = {
                    'columns': where_columns + order_columns,
                    'type': 'covering',
                    'benefit_score': query['frequency'] * query['avg_time_sec']
                }
                candidates.append(candidate)
                
        return candidates
    
    def recommend_indexes(self):
        """æ¨èæœ€ä¼˜ç´¢å¼•ç»„åˆ"""
        candidates = self.generate_index_candidates()
        
#        # æˆæœ¬æ•ˆç›Šåˆ†æ
        recommendations = []
        for candidate in candidates:
            cost = self.estimate_index_cost(candidate['columns'])
            benefit = self.estimate_performance_gain(candidate)
            
            if benefit / cost > 2.0:  # æ”¶ç›Šè¶…è¿‡æˆæœ¬2å€
                recommendations.append({
                    'sql': f"CREATE INDEX idx_auto_{len(recommendations)} ON table_name ({', '.join(candidate['columns'])})",
                    'estimated_benefit': f"{benefit:.2f}ç§’/å¤©",
                    'storage_cost': f"{cost:.2f}MB"
                })
        
        return recommendations
```

### 6.3 æ™ºèƒ½SQLé‡å†™ç³»ç»Ÿ



**ğŸ”„ SQLè‡ªåŠ¨ä¼˜åŒ–**
```
SQLé‡å†™è§„åˆ™å¼•æ“ï¼š

è§„åˆ™1ï¼šå­æŸ¥è¯¢è½¬æ¢ä¸ºJOIN
-- åŸå§‹SQLï¼ˆæ€§èƒ½å·®ï¼‰
SELECT * FROM users 
WHERE id IN (SELECT user_id FROM orders WHERE status = 'completed');

-- è‡ªåŠ¨é‡å†™ï¼ˆæ€§èƒ½å¥½ï¼‰
SELECT DISTINCT u.* FROM users u 
INNER JOIN orders o ON u.id = o.user_id 
WHERE o.status = 'completed';

è§„åˆ™2ï¼šORæ¡ä»¶è½¬æ¢ä¸ºUNION
-- åŸå§‹SQL
SELECT * FROM products 
WHERE category = 'electronics' OR category = 'computers';

-- è‡ªåŠ¨é‡å†™
SELECT * FROM products WHERE category = 'electronics'
UNION ALL
SELECT * FROM products WHERE category = 'computers';

è§„åˆ™3ï¼šå‡½æ•°ä¼˜åŒ–
-- åŸå§‹SQL
SELECT * FROM orders WHERE YEAR(order_date) = 2024;

-- è‡ªåŠ¨é‡å†™
SELECT * FROM orders 
WHERE order_date >= '2024-01-01' AND order_date < '2025-01-01';
```

**ğŸª é‡å†™ç³»ç»Ÿæ¶æ„**
```
SQLé‡å†™ç³»ç»Ÿæµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQLè§£æå™¨   â”‚ â†’ â”‚ è§„åˆ™åŒ¹é…å™¨   â”‚ â†’ â”‚ é‡å†™ç”Ÿæˆå™¨   â”‚
â”‚ è¯­æ³•åˆ†æ    â”‚    â”‚ æ¨¡å¼è¯†åˆ«    â”‚    â”‚ ä¼˜åŒ–SQL    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                   â†“                   â†“
    æŠ½è±¡è¯­æ³•æ ‘          åŒ¹é…é‡å†™è§„åˆ™         ç”Ÿæˆä¼˜åŒ–SQL
```

---

## 7. ğŸ”— è°ƒä¼˜å·¥å…·é›†æˆæ–¹æ¡ˆ



### 7.1 è°ƒä¼˜å·¥å…·é“¾è®¾è®¡



**ğŸ—ï¸ å®Œæ•´å·¥å…·é“¾æ¶æ„**
```
è°ƒä¼˜å·¥å…·é“¾ï¼šä»æ•°æ®æ”¶é›†åˆ°ä¼˜åŒ–å®æ–½çš„å®Œæ•´æµç¨‹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è°ƒä¼˜å·¥å…·é“¾æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®æ”¶é›†å±‚ï¼š                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ â”‚ æ…¢æŸ¥è¯¢æ—¥å¿—  â”‚ â”‚Performance  â”‚ â”‚ åº”ç”¨ç›‘æ§    â”‚               â”‚
â”‚ â”‚            â”‚ â”‚ Schema      â”‚ â”‚ APMå·¥å…·     â”‚               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ†æå¤„ç†å±‚ï¼š                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ â”‚pt-query-    â”‚ â”‚ è‡ªå®šä¹‰è„šæœ¬  â”‚ â”‚ AIåˆ†æå¼•æ“  â”‚               â”‚
â”‚ â”‚digest       â”‚ â”‚            â”‚ â”‚            â”‚               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å†³ç­–æ”¯æŒå±‚ï¼š                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ â”‚ ä¼˜åŒ–å»ºè®®    â”‚ â”‚ é£é™©è¯„ä¼°    â”‚ â”‚ è‡ªåŠ¨æ‰§è¡Œ    â”‚               â”‚
â”‚ â”‚ ç”Ÿæˆå™¨      â”‚ â”‚ ç³»ç»Ÿ        â”‚ â”‚ å¼•æ“        â”‚               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç›‘æ§é›†æˆæ–¹æ¡ˆ



**ğŸ“Š å¤šç»´åº¦ç›‘æ§ä½“ç³»**
```sql
-- 1. å®æ—¶æ€§èƒ½ç›‘æ§çœ‹æ¿
CREATE VIEW real_time_performance AS
SELECT 
    'ç³»ç»Ÿè´Ÿè½½' as metric_name,
    ROUND(
        (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME='Threads_running') /
        (SELECT VARIABLE_VALUE FROM performance_schema.global_variables WHERE VARIABLE_NAME='max_connections') * 100, 2
    ) as current_value,
    85 as warning_threshold,
    95 as critical_threshold
UNION ALL
SELECT 
    'æ…¢æŸ¥è¯¢ç‡',
    ROUND(
        (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME='Slow_queries') /
        (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME='Questions') * 100, 4
    ),
    2.0,
    5.0
UNION ALL
SELECT 
    'ç¼“å†²æ± å‘½ä¸­ç‡',
    ROUND(
        100 - (
            (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME='Innodb_buffer_pool_reads') /
            (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME='Innodb_buffer_pool_read_requests')
        ) * 100, 2
    ),
    95.0,
    90.0;

-- 2. æŸ¥è¯¢æ€§èƒ½è¶‹åŠ¿åˆ†æ
SELECT 
    DATE_FORMAT(FIRST_SEEN, '%Y-%m-%d %H:00:00') as hour_time,
    COUNT(DISTINCT DIGEST) as unique_queries,
    SUM(COUNT_STAR) as total_executions,
    ROUND(AVG(AVG_TIMER_WAIT)/1000000000, 2) as avg_response_time,
    ROUND(MAX(MAX_TIMER_WAIT)/1000000000, 2) as max_response_time
FROM performance_schema.events_statements_summary_by_digest
WHERE FIRST_SEEN >= DATE_SUB(NOW(), INTERVAL 24 HOUR)
GROUP BY DATE_FORMAT(FIRST_SEEN, '%Y-%m-%d %H:00:00')
ORDER BY hour_time;
```

### 7.3 å‘Šè­¦ç³»ç»Ÿé›†æˆ



**ğŸš¨ æ™ºèƒ½å‘Šè­¦é…ç½®**
```bash
#!/bin/bash

# æ€§èƒ½å‘Šè­¦è„šæœ¬


# é…ç½®å‚æ•°

MYSQL_USER="monitor"
MYSQL_PASS="password" 
MYSQL_HOST="localhost"
SLOW_QUERY_THRESHOLD=5.0  # æ…¢æŸ¥è¯¢ç‡é˜ˆå€¼5%
RESPONSE_TIME_THRESHOLD=2.0  # å¹³å‡å“åº”æ—¶é—´é˜ˆå€¼2ç§’

# æ£€æŸ¥æ…¢æŸ¥è¯¢ç‡

check_slow_query_rate() {
    local rate=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -h$MYSQL_HOST -se "
        SELECT ROUND(
            (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME='Slow_queries') /
            (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME='Questions') * 100, 2
        ) as slow_rate")
    
    if (( $(echo "$rate > $SLOW_QUERY_THRESHOLD" | bc -l) )); then
        send_alert "æ…¢æŸ¥è¯¢ç‡å‘Šè­¦" "å½“å‰æ…¢æŸ¥è¯¢ç‡: ${rate}%ï¼Œè¶…è¿‡é˜ˆå€¼${SLOW_QUERY_THRESHOLD}%"
    fi
}

# æ£€æŸ¥å¹³å‡å“åº”æ—¶é—´

check_response_time() {
    local avg_time=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -h$MYSQL_HOST -se "
        SELECT ROUND(AVG(AVG_TIMER_WAIT)/1000000000, 2)
        FROM performance_schema.events_statements_summary_by_digest
        WHERE LAST_SEEN >= DATE_SUB(NOW(), INTERVAL 5 MINUTE)")
    
    if (( $(echo "$avg_time > $RESPONSE_TIME_THRESHOLD" | bc -l) )); then
        send_alert "å“åº”æ—¶é—´å‘Šè­¦" "å¹³å‡å“åº”æ—¶é—´: ${avg_time}ç§’ï¼Œè¶…è¿‡é˜ˆå€¼${RESPONSE_TIME_THRESHOLD}ç§’"
    fi
}

# å‘é€å‘Šè­¦

send_alert() {
    local title=$1
    local message=$2
    
#    # å‘é€é’‰é’‰é€šçŸ¥
    curl -X POST https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN \
        -H 'Content-Type: application/json' \
        -d "{\"msgtype\": \"text\", \"text\": {\"content\": \"$title: $message\"}}"
    
#    # å‘é€é‚®ä»¶é€šçŸ¥  
    echo "$message" | mail -s "$title" dba@company.com
}

# ä¸»å¾ªç¯

main() {
    check_slow_query_rate
    check_response_time
}

main
```

### 7.4 è‡ªåŠ¨åŒ–ä¼˜åŒ–æ‰§è¡Œ



**âš™ï¸ è‡ªåŠ¨ä¼˜åŒ–å¼•æ“**
```python
class AutoTuningEngine:
    """è‡ªåŠ¨SQLè°ƒä¼˜å¼•æ“"""
    
    def __init__(self, config):
        self.db = config['database']
        self.safety_mode = config.get('safety_mode', True)  # å®‰å…¨æ¨¡å¼
        self.max_auto_changes = config.get('max_auto_changes', 3)  # æ¯æ—¥æœ€å¤§è‡ªåŠ¨å˜æ›´
        
    def analyze_and_optimize(self):
        """åˆ†æå¹¶æ‰§è¡Œä¼˜åŒ–"""
        
#        # 1. æ”¶é›†æ€§èƒ½æ•°æ®
        performance_data = self.collect_performance_data()
        
#        # 2. ç”Ÿæˆä¼˜åŒ–å»ºè®®
        recommendations = self.generate_recommendations(performance_data)
        
#        # 3. é£é™©è¯„ä¼°
        safe_recommendations = self.risk_assessment(recommendations)
        
#        # 4. æ‰§è¡Œä¼˜åŒ–ï¼ˆå¦‚æœåœ¨å®‰å…¨èŒƒå›´å†…ï¼‰
        if self.safety_mode:
            self.execute_safe_recommendations(safe_recommendations)
        else:
            self.execute_all_recommendations(recommendations)
            
    def generate_recommendations(self, data):
        """ç”Ÿæˆä¼˜åŒ–å»ºè®®"""
        recommendations = []
        
#        # åˆ†ææ…¢æŸ¥è¯¢æ¨¡å¼
        for query in data['slow_queries']:
            if query['avg_time'] > 5 and query['frequency'] > 100:
#                # é«˜é¢‘æ…¢æŸ¥è¯¢ï¼Œä¼˜å…ˆä¼˜åŒ–
                rec = self.analyze_query_optimization(query)
                rec['priority'] = 'HIGH'
                rec['impact_score'] = query['frequency'] * query['avg_time']
                recommendations.append(rec)
        
#        # åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
        for table in data['table_stats']:
            if table['scan_ratio'] > 0.3:  # å…¨è¡¨æ‰«ææ¯”ä¾‹>30%
                rec = {
                    'type': 'ADD_INDEX',
                    'table': table['name'],
                    'columns': table['frequently_filtered_columns'],
                    'reason': f'å…¨è¡¨æ‰«ææ¯”ä¾‹{table["scan_ratio"]:.1%}è¿‡é«˜'
                }
                recommendations.append(rec)
        
        return sorted(recommendations, key=lambda x: x.get('impact_score', 0), reverse=True)
    
    def risk_assessment(self, recommendations):
        """é£é™©è¯„ä¼°"""
        safe_recs = []
        
        for rec in recommendations:
            risk_level = self.calculate_risk(rec)
            
            if risk_level == 'LOW':
                safe_recs.append(rec)
            elif risk_level == 'MEDIUM':
                rec['requires_approval'] = True
                safe_recs.append(rec)
            else:
                rec['status'] = 'REJECTED_HIGH_RISK'
                self.log_recommendation(rec)
        
        return safe_recs
    
    def execute_safe_recommendations(self, recommendations):
        """æ‰§è¡Œå®‰å…¨çš„ä¼˜åŒ–å»ºè®®"""
        executed_count = 0
        
        for rec in recommendations:
            if executed_count >= self.max_auto_changes:
                break
                
            if rec.get('requires_approval'):
                self.send_approval_request(rec)
                continue
            
            try:
#                # åˆ›å»ºå¤‡ä»½ç‚¹
                self.create_checkpoint()
                
#                # æ‰§è¡Œä¼˜åŒ–
                self.execute_optimization(rec)
                
#                # éªŒè¯æ•ˆæœ
                effect = self.validate_optimization_effect(rec)
                
                if effect['improvement'] > 0.1:  # æ”¹å–„è¶…è¿‡10%
                    self.log_success(rec, effect)
                    executed_count += 1
                else:
#                    # æ•ˆæœä¸æ˜æ˜¾ï¼Œå›æ»š
                    self.rollback_optimization(rec)
                    
            except Exception as e:
                self.log_error(rec, e)
                self.rollback_optimization(rec)
```

---

## 8. ğŸ† å·¥å…·é€‰å‹ä¸æ•ˆæœè¯„ä¼°



### 8.1 ä¼ä¸šçº§è°ƒä¼˜å·¥å…·é€‰å‹



**ğŸ¯ é€‰å‹å†³ç­–æ¡†æ¶**
```
é€‰å‹ç»´åº¦è¯„ä¼°ï¼š

æŠ€æœ¯ç»´åº¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠŸèƒ½å®Œæ•´æ€§ï¼šç›‘æ§â†’åˆ†æâ†’å»ºè®®â†’æ‰§è¡Œ              â”‚
â”‚ æ˜“ç”¨æ€§ï¼šç•Œé¢å‹å¥½åº¦ã€å­¦ä¹ æ›²çº¿                â”‚
â”‚ å‡†ç¡®æ€§ï¼šåˆ†æç»“æœçš„å¯é æ€§                    â”‚
â”‚ æ€§èƒ½å½±å“ï¼šå¯¹ç”Ÿäº§ç¯å¢ƒçš„æ€§èƒ½å½±å“              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å•†ä¸šç»´åº¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æˆæœ¬ï¼šè®¸å¯è´¹ç”¨ã€ç¡¬ä»¶è¦æ±‚ã€äººåŠ›æŠ•å…¥              â”‚
â”‚ æ”¯æŒï¼šæŠ€æœ¯æ”¯æŒã€æ–‡æ¡£è´¨é‡ã€ç¤¾åŒºæ´»è·ƒåº¦            â”‚
â”‚ é›†æˆï¼šä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆéš¾åº¦                    â”‚
â”‚ æ‰©å±•ï¼šæ”¯æŒå¤šæ•°æ®åº“ã€å¤šç¯å¢ƒ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é£é™©ç»´åº¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¾›åº”å•†é£é™©ï¼šå‚å•†ç¨³å®šæ€§ã€äº§å“è·¯çº¿å›¾              â”‚
â”‚ æŠ€æœ¯é£é™©ï¼šå·¥å…·ç¨³å®šæ€§ã€å®‰å…¨æ€§                  â”‚
â”‚ æ“ä½œé£é™©ï¼šè¯¯æ“ä½œé£é™©ã€å›æ»šèƒ½åŠ›                â”‚
â”‚ åˆè§„é£é™©ï¼šæ•°æ®å®‰å…¨ã€å®¡è®¡è¦æ±‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š ä¸»æµå·¥å…·å¯¹æ¯”çŸ©é˜µ**

| **å·¥å…·ç±»åˆ«** | **ä»£è¡¨äº§å“** | **é€‚ç”¨è§„æ¨¡** | **ä¼˜åŠ¿** | **é™åˆ¶** | **æ¨èåº¦** |
|-------------|-------------|-------------|---------|---------|----------|
| **åŸç”Ÿå·¥å…·** | `EXPLAIN + Performance Schema` | ä¸­å°å‹ | å…è´¹ã€ç¨³å®šã€æ·±åº¦é›†æˆ | åŠŸèƒ½æœ‰é™ã€éœ€è¦ä¸“ä¸šæŠ€èƒ½ | â­â­â­â­ |
| **å¼€æºå·¥å…·** | `Percona Toolkit + PMM` | ä¸­å¤§å‹ | åŠŸèƒ½å¼ºå¤§ã€ç¤¾åŒºæ”¯æŒå¥½ | é…ç½®å¤æ‚ã€å­¦ä¹ æˆæœ¬é«˜ | â­â­â­â­â­ |
| **äº‘å¹³å°å·¥å…·** | `é˜¿é‡Œäº‘DAS + AWS Performance Insights` | å¤§å‹ | AIé©±åŠ¨ã€è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜ | ä¾èµ–äº‘å¹³å°ã€æˆæœ¬è¾ƒé«˜ | â­â­â­â­ |
| **å•†ä¸šå·¥å…·** | `Quest Spotlight + SolarWinds DPA` | ä¼ä¸šçº§ | åŠŸèƒ½æœ€å…¨ã€æ”¯æŒæœ€å¥½ | ä»·æ ¼æ˜‚è´µã€å‚å•†é”å®š | â­â­â­ |

### 8.2 è°ƒä¼˜æ•ˆæœè¯„ä¼°ä½“ç³»



**ğŸ“ˆ è¯„ä¼°æŒ‡æ ‡ä½“ç³»**
```
æ€§èƒ½æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å“åº”æ—¶é—´æŒ‡æ ‡                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å¹³å‡å“åº”æ—¶é—´ï¼šä¼˜åŒ–å‰åçš„å¹³å‡æŸ¥è¯¢æ—¶é—´          â”‚
â”‚ â€¢ 95%å“åº”æ—¶é—´ï¼š95%æŸ¥è¯¢çš„å“åº”æ—¶é—´                â”‚
â”‚ â€¢ å³°å€¼å“åº”æ—¶é—´ï¼šæœ€æ…¢æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´              â”‚
â”‚ â€¢ å“åº”æ—¶é—´åˆ†å¸ƒï¼šå„æ—¶é—´æ®µçš„æŸ¥è¯¢åˆ†å¸ƒ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ååé‡æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰ï¼šç³»ç»Ÿå¤„ç†èƒ½åŠ›              â”‚
â”‚ â€¢ TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰ï¼šäº‹åŠ¡å¤„ç†èƒ½åŠ›              â”‚
â”‚ â€¢ å¹¶å‘å¤„ç†èƒ½åŠ›ï¼šåŒæ—¶å¤„ç†çš„è¿æ¥æ•°               â”‚
â”‚ â€¢ èµ„æºåˆ©ç”¨ç‡ï¼šCPUã€å†…å­˜ã€IOä½¿ç”¨ç‡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è´¨é‡æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ æ…¢æŸ¥è¯¢æ•°é‡ï¼šä¼˜åŒ–åæ…¢æŸ¥è¯¢çš„å‡å°‘é‡              â”‚
â”‚ â€¢ ç´¢å¼•å‘½ä¸­ç‡ï¼šç´¢å¼•ä½¿ç”¨çš„æœ‰æ•ˆæ€§                 â”‚
â”‚ â€¢ æŸ¥è¯¢æ•ˆç‡ï¼šæ‰«æè¡Œæ•°ä¸è¿”å›è¡Œæ•°çš„æ¯”ä¾‹            â”‚
â”‚ â€¢ é”™è¯¯ç‡ï¼šæŸ¥è¯¢æ‰§è¡Œå¤±è´¥çš„æ¯”ä¾‹                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ ROIï¼ˆæŠ•èµ„å›æŠ¥ç‡ï¼‰è®¡ç®—**
```sql
-- ä¼˜åŒ–æ•ˆæœé‡åŒ–æŸ¥è¯¢
WITH optimization_metrics AS (
    -- ä¼˜åŒ–å‰çš„åŸºçº¿æ•°æ®ï¼ˆå‡è®¾å·²ä¿å­˜ï¼‰
    SELECT 
        'baseline' as period,
        AVG(avg_timer_wait)/1000000000 as avg_response_time,
        SUM(count_star) as total_queries,
        COUNT(CASE WHEN avg_timer_wait > 2000000000 THEN 1 END) as slow_queries
    FROM performance_schema.events_statements_summary_by_digest_baseline
    
    UNION ALL
    
    -- ä¼˜åŒ–åçš„å½“å‰æ•°æ®  
    SELECT 
        'current' as period,
        AVG(avg_timer_wait)/1000000000 as avg_response_time,
        SUM(count_star) as total_queries,
        COUNT(CASE WHEN avg_timer_wait > 2000000000 THEN 1 END) as slow_queries
    FROM performance_schema.events_statements_summary_by_digest
    WHERE last_seen >= DATE_SUB(NOW(), INTERVAL 7 DAY)
)
SELECT 
    b.avg_response_time as baseline_avg_time,
    c.avg_response_time as current_avg_time,
    ROUND((b.avg_response_time - c.avg_response_time) / b.avg_response_time * 100, 1) as improvement_pct,
    b.slow_queries as baseline_slow_queries,
    c.slow_queries as current_slow_queries,
    ROUND((b.slow_queries - c.slow_queries) / b.slow_queries * 100, 1) as slow_query_reduction_pct
FROM 
    (SELECT * FROM optimization_metrics WHERE period = 'baseline') b
CROSS JOIN 
    (SELECT * FROM optimization_metrics WHERE period = 'current') c;
```

### 8.3 è°ƒä¼˜å·¥å…·æœ€ä½³å®è·µ



**âœ… å®æ–½æœ€ä½³å®è·µ**
```
åˆ†é˜¶æ®µå®æ–½ç­–ç•¥ï¼š

é˜¶æ®µ1ï¼šåŸºç¡€ç›‘æ§å»ºç«‹ï¼ˆ1-2å‘¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—å’ŒPerformance Schema           â”‚
â”‚ 2. é…ç½®åŸºç¡€ç›‘æ§å‘Šè­¦                            â”‚
â”‚ 3. å»ºç«‹æ€§èƒ½åŸºçº¿                                â”‚
â”‚ 4. å›¢é˜ŸåŸ¹è®­åŸºç¡€å·¥å…·ä½¿ç”¨                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2ï¼šæ·±åº¦åˆ†æèƒ½åŠ›ï¼ˆ2-3å‘¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. éƒ¨ç½²pt-query-digeståˆ†æ                     â”‚
â”‚ 2. å»ºç«‹å®šæœŸæ€§èƒ½æŠ¥å‘Š                            â”‚
â”‚ 3. è¯†åˆ«TOPæ€§èƒ½é—®é¢˜                            â”‚
â”‚ 4. åˆ¶å®šä¼˜åŒ–è®¡åˆ’                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ3ï¼šè‡ªåŠ¨åŒ–ä¼˜åŒ–ï¼ˆ3-4å‘¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å®æ–½è‡ªåŠ¨ç´¢å¼•å»ºè®®                            â”‚
â”‚ 2. é…ç½®æ™ºèƒ½å‘Šè­¦                                â”‚
â”‚ 3. å»ºç«‹ä¼˜åŒ–æ•ˆæœè·Ÿè¸ª                            â”‚
â”‚ 4. æŒç»­ä¼˜åŒ–è¿­ä»£                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”’ å®‰å…¨å®è·µåŸåˆ™**
```
ç”Ÿäº§ç¯å¢ƒå®‰å…¨åŸåˆ™ï¼š

1ï¸âƒ£ åªè¯»åˆ†æï¼š
âœ… ä½¿ç”¨åªè¯»è´¦å·è¿›è¡Œæ€§èƒ½åˆ†æ
âœ… é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æ‰§è¡Œå˜æ›´
âœ… é€šè¿‡æµ‹è¯•ç¯å¢ƒéªŒè¯ä¼˜åŒ–æ–¹æ¡ˆ

2ï¸âƒ£ æ¸è¿›å¼ä¼˜åŒ–ï¼š
âœ… å°æ‰¹é‡ã€åˆ†æ­¥éª¤æ‰§è¡Œä¼˜åŒ–
âœ… æ¯æ¬¡å˜æ›´åè§‚å¯Ÿæ•ˆæœ
âœ… å‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ

3ï¸âƒ£ ç›‘æ§éªŒè¯ï¼š
âœ… ä¼˜åŒ–å‰åæ€§èƒ½å¯¹æ¯”
âœ… ä¸šåŠ¡åŠŸèƒ½æ­£ç¡®æ€§éªŒè¯
âœ… ç”¨æˆ·ä½“éªŒå½±å“è¯„ä¼°

4ï¸âƒ£ æ–‡æ¡£è®°å½•ï¼š
âœ… è¯¦ç»†è®°å½•æ¯æ¬¡ä¼˜åŒ–æ“ä½œ
âœ… ä¿å­˜ä¼˜åŒ–å‰åçš„æ€§èƒ½æ•°æ®
âœ… å»ºç«‹çŸ¥è¯†åº“ä¾›å›¢é˜Ÿå…±äº«
```

### 8.4 å·¥å…·é€‰å‹å†³ç­–æ”¯æŒç³»ç»Ÿ



**ğŸ›ï¸ å†³ç­–æ”¯æŒæ¡†æ¶**
```python
class TuningToolSelector:
    """è°ƒä¼˜å·¥å…·é€‰å‹å†³ç­–æ”¯æŒç³»ç»Ÿ"""
    
    def __init__(self):
        self.evaluation_criteria = {
            'functionality': 0.3,    # åŠŸèƒ½æ€§æƒé‡30%
            'usability': 0.2,        # æ˜“ç”¨æ€§æƒé‡20%  
            'cost': 0.2,            # æˆæœ¬æƒé‡20%
            'support': 0.15,         # æ”¯æŒæƒé‡15%
            'integration': 0.15      # é›†æˆæ€§æƒé‡15%
        }
    
    def evaluate_tools(self, requirements, tools):
        """è¯„ä¼°å·¥å…·é€‚é…åº¦"""
        results = {}
        
        for tool_name, tool_info in tools.items():
            score = self.calculate_tool_score(requirements, tool_info)
            results[tool_name] = {
                'total_score': score,
                'recommendation': self.get_recommendation(score),
                'details': self.get_evaluation_details(requirements, tool_info)
            }
        
        return sorted(results.items(), key=lambda x: x[1]['total_score'], reverse=True)
    
    def calculate_tool_score(self, requirements, tool_info):
        """è®¡ç®—å·¥å…·è¯„åˆ†"""
        score = 0
        
#        # åŠŸèƒ½æ€§è¯„åˆ†
        functionality_score = self.evaluate_functionality(requirements, tool_info)
        score += functionality_score * self.evaluation_criteria['functionality']
        
#        # æ˜“ç”¨æ€§è¯„åˆ†
        usability_score = self.evaluate_usability(requirements, tool_info)
        score += usability_score * self.evaluation_criteria['usability']
        
#        # æˆæœ¬è¯„åˆ†
        cost_score = self.evaluate_cost(requirements, tool_info)
        score += cost_score * self.evaluation_criteria['cost']
        
#        # æ”¯æŒè¯„åˆ†
        support_score = self.evaluate_support(requirements, tool_info)
        score += support_score * self.evaluation_criteria['support']
        
#        # é›†æˆæ€§è¯„åˆ†
        integration_score = self.evaluate_integration(requirements, tool_info)
        score += integration_score * self.evaluation_criteria['integration']
        
        return round(score, 2)
    
    def generate_recommendation_report(self, results, requirements):
        """ç”Ÿæˆæ¨èæŠ¥å‘Š"""
        report = f"""
# è°ƒä¼˜å·¥å…·é€‰å‹æ¨èæŠ¥å‘Š


# éœ€æ±‚æ¦‚è¿°


- æ•°æ®åº“è§„æ¨¡ï¼š{requirements.get('db_size', 'N/A')}
- å›¢é˜ŸæŠ€èƒ½ï¼š{requirements.get('team_skill', 'N/A')}
- é¢„ç®—èŒƒå›´ï¼š{requirements.get('budget', 'N/A')}
- å…³é”®éœ€æ±‚ï¼š{', '.join(requirements.get('key_requirements', []))}

# æ¨èç»“æœ


"""
        
        for i, (tool_name, tool_result) in enumerate(results[:3], 1):
            report += f"""
## {i}. {tool_name} (è¯„åˆ†: {tool_result['total_score']}/10)


- **æ¨èåº¦**: {tool_result['recommendation']}
- **é€‚ç”¨åœºæ™¯**: {tool_result['details']['best_use_case']}
- **ä¸»è¦ä¼˜åŠ¿**: {', '.join(tool_result['details']['advantages'])}
- **æ³¨æ„äº‹é¡¹**: {', '.join(tool_result['details']['limitations'])}
"""
        
        report += f"""
# å®æ–½å»ºè®®


1. **çŸ­æœŸæ–¹æ¡ˆ**: å…ˆä½¿ç”¨{results[0][0]}å»ºç«‹åŸºç¡€ç›‘æ§èƒ½åŠ›
2. **ä¸­æœŸè§„åˆ’**: æ ¹æ®å›¢é˜ŸæŠ€èƒ½æˆé•¿ï¼Œè€ƒè™‘å‡çº§åˆ°æ›´é«˜çº§å·¥å…·
3. **é•¿æœŸç›®æ ‡**: å»ºç«‹å®Œæ•´çš„è‡ªåŠ¨åŒ–è°ƒä¼˜ä½“ç³»

# é£é™©æç¤º


- å·¥å…·éƒ¨ç½²å‰åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
- å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå›æ»šæœºåˆ¶
- å®šæœŸè¯„ä¼°å·¥å…·ä½¿ç”¨æ•ˆæœå’Œæˆæœ¬
"""
        
        return report
```

---

## 9. ğŸ¯ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ è°ƒä¼˜å·¥å…·æœ¬è´¨ï¼šä»æ•°æ®æ”¶é›†â†’åˆ†æè¯Šæ–­â†’ä¼˜åŒ–å»ºè®®â†’æ•ˆæœéªŒè¯çš„å®Œæ•´é“¾æ¡
ğŸ”¸ å·¥å…·åˆ†ç±»ï¼šåŸç”Ÿå·¥å…·ã€å¼€æºå·¥å…·ã€å•†ä¸šå·¥å…·ã€äº‘å¹³å°å·¥å…·å„æœ‰ç‰¹ç‚¹
ğŸ”¸ EXPLAINåˆ†æï¼šæ‰§è¡Œè®¡åˆ’æ˜¯SQLè°ƒä¼˜çš„åŸºç¡€ï¼Œé‡ç‚¹å…³æ³¨typeå’ŒExtraå­—æ®µ
ğŸ”¸ æ€§èƒ½ç›‘æ§ï¼šPerformance Schemaæä¾›å®æ—¶è¯¦ç»†çš„æ€§èƒ½æ•°æ®
ğŸ”¸ è‡ªåŠ¨åŒ–è¶‹åŠ¿ï¼šAIé©±åŠ¨çš„æ™ºèƒ½è°ƒä¼˜æ˜¯æœªæ¥å‘å±•æ–¹å‘
```

### 9.2 å…³é”®æŠ€æœ¯è¦ç‚¹



**ğŸ”¹ EXPLAINæ‰§è¡Œè®¡åˆ’è§£è¯»**
```
typeå­—æ®µä¼˜å…ˆçº§ï¼ˆæ€§èƒ½ä»é«˜åˆ°ä½ï¼‰ï¼š
const > eq_ref > ref > range > index > ALL

å±é™©ä¿¡å·è¯†åˆ«ï¼š
âŒ type=ALLï¼šå…¨è¡¨æ‰«æï¼Œå¿…é¡»ä¼˜åŒ–
âŒ ExtraåŒ…å«Using filesortï¼šæ’åºæ— æ³•ä½¿ç”¨ç´¢å¼•
âŒ ExtraåŒ…å«Using temporaryï¼šGROUP BYéœ€è¦ä¸´æ—¶è¡¨
âŒ rowsæ•°å€¼å¾ˆå¤§ï¼šé¢„ä¼°æ‰«æè¡Œæ•°è¿‡å¤š

ä¼˜åŒ–æ–¹å‘ï¼š
ğŸ“Œ æ·»åŠ åˆé€‚çš„ç´¢å¼•
ğŸ“Œ è°ƒæ•´æŸ¥è¯¢æ¡ä»¶
ğŸ“Œ é‡å†™SQLè¯­å¥
ğŸ“Œ ä¼˜åŒ–è¡¨ç»“æ„
```

**ğŸ”¹ å·¥å…·é€‰æ‹©å†³ç­–**
```
æ ¹æ®åœºæ™¯é€‰æ‹©å·¥å…·ï¼š
å¼€å‘é˜¶æ®µï¼šEXPLAIN + SHOW PROFILEï¼ˆå¿«é€Ÿå®šä½ï¼‰
æµ‹è¯•é˜¶æ®µï¼šPerformance Schema + pt-query-digestï¼ˆæ·±åº¦åˆ†æï¼‰
ç”Ÿäº§ç¯å¢ƒï¼šç›‘æ§å¹³å° + è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå®æ—¶ç›‘æ§ï¼‰
è¿ç»´ä¼˜åŒ–ï¼šä¸“ä¸šå·¥å…· + AIè¾…åŠ©ï¼ˆç³»ç»Ÿä¼˜åŒ–ï¼‰

æˆæœ¬æ•ˆç›Šå¹³è¡¡ï¼š
ğŸ“Œ å°å‹é¡¹ç›®ï¼šä¼˜å…ˆä½¿ç”¨å…è´¹çš„åŸç”Ÿå·¥å…·
ğŸ“Œ ä¸­å‹é¡¹ç›®ï¼šå¼€æºå·¥å…·ç»„åˆï¼Œå¦‚Percona Toolkit
ğŸ“Œ å¤§å‹é¡¹ç›®ï¼šè€ƒè™‘å•†ä¸šå·¥å…·æˆ–äº‘å¹³å°æ–¹æ¡ˆ
ğŸ“Œ ä¼ä¸šçº§ï¼šæ„å»ºå®Œæ•´çš„è‡ªåŠ¨åŒ–è°ƒä¼˜å¹³å°
```

**ğŸ”¹ ç›‘æ§å‘Šè­¦ç­–ç•¥**
```
åˆ†å±‚ç›‘æ§ä½“ç³»ï¼š
å®æ—¶ç›‘æ§ï¼šå…³é”®æ€§èƒ½æŒ‡æ ‡çš„å®æ—¶è·Ÿè¸ª
è¶‹åŠ¿åˆ†æï¼šæ€§èƒ½å˜åŒ–è¶‹åŠ¿çš„é•¿æœŸè§‚å¯Ÿ
å¼‚å¸¸æ£€æµ‹ï¼šåŸºäºå†å²æ•°æ®çš„å¼‚å¸¸è¯†åˆ«
é¢„æµ‹é¢„è­¦ï¼šåŸºäºè¶‹åŠ¿çš„æ€§èƒ½é£é™©é¢„æµ‹

å‘Šè­¦é˜ˆå€¼è®¾ç½®ï¼š
ğŸ“Œ æ…¢æŸ¥è¯¢ç‡ï¼š>2%å‘Šè­¦ï¼Œ>5%ä¸¥é‡å‘Šè­¦
ğŸ“Œ å¹³å‡å“åº”æ—¶é—´ï¼š>2ç§’å‘Šè­¦ï¼Œ>5ç§’ä¸¥é‡å‘Šè­¦
ğŸ“Œ CPUä½¿ç”¨ç‡ï¼š>80%å‘Šè­¦ï¼Œ>90%ä¸¥é‡å‘Šè­¦
ğŸ“Œ è¿æ¥æ•°ï¼š>70%æœ€å¤§è¿æ¥æ•°å‘Šè­¦
```

### 9.3 å®æ–½æˆåŠŸçš„å…³é”®å› ç´ 



**ğŸ† æˆåŠŸè¦ç´ **
```
1ï¸âƒ£ å·¥å…·ä½“ç³»å»ºè®¾ï¼š
   - é€‰æ‹©é€‚åˆå›¢é˜ŸæŠ€èƒ½çš„å·¥å…·ç»„åˆ
   - å»ºç«‹ä»ç›‘æ§åˆ°ä¼˜åŒ–çš„å®Œæ•´æµç¨‹
   - åˆ¶å®šæ ‡å‡†åŒ–çš„æ“ä½œè§„èŒƒ

2ï¸âƒ£ å›¢é˜Ÿèƒ½åŠ›å»ºè®¾ï¼š
   - åŸ¹è®­å›¢é˜ŸæŒæ¡å·¥å…·ä½¿ç”¨æ–¹æ³•
   - å»ºç«‹æ€§èƒ½é—®é¢˜å¤„ç†æµç¨‹
   - ç§¯ç´¯ä¼˜åŒ–ç»éªŒå’Œæœ€ä½³å®è·µ

3ï¸âƒ£ æŒç»­æ”¹è¿›æœºåˆ¶ï¼š
   - å®šæœŸè¯„ä¼°å·¥å…·ä½¿ç”¨æ•ˆæœ
   - æ ¹æ®ä¸šåŠ¡å‘å±•è°ƒæ•´ç›‘æ§ç­–ç•¥
   - è·Ÿè¸ªæ–°æŠ€æœ¯å’Œå·¥å…·å‘å±•

4ï¸âƒ£ é£é™©æ§åˆ¶ï¼š
   - å»ºç«‹å®Œå–„çš„æµ‹è¯•éªŒè¯æµç¨‹
   - åˆ¶å®šè¯¦ç»†çš„å›æ»šé¢„æ¡ˆ
   - ç¡®ä¿ç”Ÿäº§ç¯å¢ƒå®‰å…¨
```

**ğŸ’¡ å¸¸è§è¯¯åŒºä¸é¿å…**
```
âŒ è¯¯åŒº1ï¼šå·¥å…·è¶Šå¤šè¶Šå¥½
âœ… æ­£ç¡®ï¼šé€‰æ‹©é€‚åˆçš„å·¥å…·ç»„åˆï¼Œé¿å…å·¥å…·æ³›æ»¥

âŒ è¯¯åŒº2ï¼šå®Œå…¨ä¾èµ–è‡ªåŠ¨åŒ–å·¥å…·
âœ… æ­£ç¡®ï¼šå·¥å…·æä¾›å»ºè®®ï¼Œæœ€ç»ˆå†³ç­–éœ€è¦äººå·¥åˆ¤æ–­

âŒ è¯¯åŒº3ï¼šåªå…³æ³¨å·¥å…·åŠŸèƒ½ï¼Œå¿½è§†ä½¿ç”¨æˆæœ¬
âœ… æ­£ç¡®ï¼šç»¼åˆè€ƒè™‘åŠŸèƒ½ã€æˆæœ¬ã€ç»´æŠ¤ç­‰å› ç´ 

âŒ è¯¯åŒº4ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥å°è¯•æ–°å·¥å…·
âœ… æ­£ç¡®ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯å†ä¸Šçº¿
```

### 9.4 æœªæ¥å‘å±•è¶‹åŠ¿



**ğŸš€ æŠ€æœ¯å‘å±•æ–¹å‘**
```
AIæ™ºèƒ½åŒ–ï¼š
ğŸ”¸ æœºå™¨å­¦ä¹ é©±åŠ¨çš„æ€§èƒ½åˆ†æ
ğŸ”¸ è‡ªåŠ¨åŒ–çš„ä¼˜åŒ–å»ºè®®ç”Ÿæˆ
ğŸ”¸ æ™ºèƒ½åŒ–çš„å¼‚å¸¸æ£€æµ‹å’Œé¢„æµ‹
ğŸ”¸ è‡ªé€‚åº”çš„å‚æ•°è°ƒä¼˜

äº‘åŸç”ŸåŒ–ï¼š
ğŸ”¸ å®¹å™¨åŒ–çš„ç›‘æ§å·¥å…·éƒ¨ç½²
ğŸ”¸ å¾®æœåŠ¡æ¶æ„çš„æ€§èƒ½ç›‘æ§
ğŸ”¸ äº‘å¹³å°é›†æˆçš„è°ƒä¼˜æœåŠ¡
ğŸ”¸ å¤šäº‘ç¯å¢ƒçš„ç»Ÿä¸€ç›‘æ§

å®æ—¶åŒ–ï¼š
ğŸ”¸ æµå¼æ•°æ®å¤„ç†çš„æ€§èƒ½åˆ†æ
ğŸ”¸ å®æ—¶ä¼˜åŒ–å»ºè®®çš„æ¨é€
ğŸ”¸ å³æ—¶çš„æ€§èƒ½é—®é¢˜å‘ç°
ğŸ”¸ åŠ¨æ€çš„èµ„æºè°ƒæ•´
```

**ğŸ¯ åº”ç”¨ä»·å€¼å±•æœ›**
```
æ•ˆç‡æå‡ï¼š
- è‡ªåŠ¨åŒ–å‡å°‘äººå·¥å¹²é¢„90%
- é—®é¢˜å‘ç°æ—¶é—´ç¼©çŸ­80%
- ä¼˜åŒ–å†³ç­–å‡†ç¡®ç‡æå‡70%

æˆæœ¬æ§åˆ¶ï¼š
- ç¡¬ä»¶èµ„æºåˆ©ç”¨ç‡æå‡50%
- è¿ç»´äººåŠ›æˆæœ¬é™ä½60%
- ä¸šåŠ¡ä¸­æ–­æ—¶é—´å‡å°‘90%

è´¨é‡ä¿éšœï¼š
- ç³»ç»Ÿç¨³å®šæ€§æå‡æ˜¾è‘—
- ç”¨æˆ·ä½“éªŒæŒç»­æ”¹å–„
- ä¸šåŠ¡è¿ç»­æ€§å¾—åˆ°ä¿éšœ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> å·¥å…·é€‰å‹çœ‹åœºæ™¯ï¼Œå…è´¹å¼€æºå•†ä¸šäº‘  
> EXPLAINåˆ†ææ˜¯åŸºç¡€ï¼Œtypeå­—æ®µæœ€å…³é”®  
> ç›‘æ§å‘Šè­¦è¦åˆ†å±‚ï¼Œè‡ªåŠ¨ä¼˜åŒ–è¦è°¨æ…  
> æŒç»­æ”¹è¿›æ˜¯ç‹é“ï¼Œå®‰å…¨ç¬¬ä¸€ä¸èƒ½å¿˜