---
title: 4ã€å€’æ’ç´¢å¼•ä¸å¸ƒéš†è¿‡æ»¤å™¨
---
## ğŸ“š ç›®å½•

1. [å€’æ’ç´¢å¼•åŸºç¡€åŸç†](#1-å€’æ’ç´¢å¼•åŸºç¡€åŸç†)
2. [å€’æ’ç´¢å¼•ä¼˜åŒ–ç®—æ³•](#2-å€’æ’ç´¢å¼•ä¼˜åŒ–ç®—æ³•)
3. [å¸ƒéš†è¿‡æ»¤å™¨æ ¸å¿ƒæœºåˆ¶](#3-å¸ƒéš†è¿‡æ»¤å™¨æ ¸å¿ƒæœºåˆ¶)
4. [å¸ƒéš†è¿‡æ»¤å™¨å‚æ•°è°ƒä¼˜](#4-å¸ƒéš†è¿‡æ»¤å™¨å‚æ•°è°ƒä¼˜)
5. [å‡é˜³æ€§æ§åˆ¶ç­–ç•¥](#5-å‡é˜³æ€§æ§åˆ¶ç­–ç•¥)
6. [è¿‡æ»¤å™¨å‘½ä¸­ç‡ä¼˜åŒ–](#6-è¿‡æ»¤å™¨å‘½ä¸­ç‡ä¼˜åŒ–)
7. [å†…å­˜ä½¿ç”¨ä¼˜åŒ–æŠ€æœ¯](#7-å†…å­˜ä½¿ç”¨ä¼˜åŒ–æŠ€æœ¯)
8. [å¤§æ•°æ®åœºæ™¯åº”ç”¨å®è·µ](#8-å¤§æ•°æ®åœºæ™¯åº”ç”¨å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å€’æ’ç´¢å¼•åŸºç¡€åŸç†


### 1.1 ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•


**ğŸ¯ æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**
å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰æ˜¯ä¸€ç§ç´¢å¼•æ•°æ®ç»“æ„ï¼Œå®ƒå°†æ¯ä¸ªå…³é”®è¯æ˜ å°„åˆ°åŒ…å«è¯¥å…³é”®è¯çš„æ–‡æ¡£åˆ—è¡¨ã€‚è¿™ä¸ªåå­—å«"å€’æ’"æ˜¯å› ä¸ºå®ƒé¢ å€’äº†æ­£å¸¸çš„æ–‡æ¡£-è¯æ±‡å…³ç³»ã€‚

```
æ­£å‘ç´¢å¼•ï¼ˆæ–‡æ¡£â†’è¯æ±‡ï¼‰ï¼š
æ–‡æ¡£1 â†’ [è‹¹æœ, æ‰‹æœº, ä»·æ ¼]
æ–‡æ¡£2 â†’ [å®‰å“, æ‰‹æœº, ç³»ç»Ÿ] 
æ–‡æ¡£3 â†’ [è‹¹æœ, ç”µè„‘, é…ç½®]

å€’æ’ç´¢å¼•ï¼ˆè¯æ±‡â†’æ–‡æ¡£ï¼‰ï¼š
è‹¹æœ â†’ [æ–‡æ¡£1, æ–‡æ¡£3]
æ‰‹æœº â†’ [æ–‡æ¡£1, æ–‡æ¡£2]
ä»·æ ¼ â†’ [æ–‡æ¡£1]
å®‰å“ â†’ [æ–‡æ¡£2]
ç³»ç»Ÿ â†’ [æ–‡æ¡£2]
ç”µè„‘ â†’ [æ–‡æ¡£3]
é…ç½® â†’ [æ–‡æ¡£3]
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å€’æ’ç´¢å¼•**
- **å¿«é€ŸæŸ¥æ‰¾**ï¼šæƒ³æ‰¾åŒ…å«"è‹¹æœ"çš„æ–‡æ¡£æ—¶ï¼Œç›´æ¥æŸ¥å€’æ’ç´¢å¼•æ¯”éå†æ‰€æœ‰æ–‡æ¡£å¿«å¾—å¤š
- **å…¨æ–‡æœç´¢**ï¼šæœç´¢å¼•æ“å¿…é¡»èƒ½å¿«é€Ÿæ‰¾åˆ°åŒ…å«ç‰¹å®šè¯æ±‡çš„æ‰€æœ‰é¡µé¢
- **ç©ºé—´æ•ˆç‡**ï¼šç›¸æ¯”å­˜å‚¨æ‰€æœ‰æ–‡æ¡£å†…å®¹ï¼Œç´¢å¼•å ç”¨ç©ºé—´æ›´å°

### 1.2 å€’æ’ç´¢å¼•åŸºæœ¬ç»“æ„


**ğŸ—ï¸ ç´¢å¼•ç»“æ„ç»„æˆ**
```
å€’æ’ç´¢å¼• = è¯å…¸ + å€’æ’åˆ—è¡¨

è¯å…¸(Term Dictionary):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¯æ±‡   â”‚    é¢‘ç‡     â”‚  å€’æ’åˆ—è¡¨æŒ‡é’ˆ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è‹¹æœ   â”‚      2      â”‚    ptr1     â”‚
â”‚  æ‰‹æœº   â”‚      2      â”‚    ptr2     â”‚  
â”‚  ä»·æ ¼   â”‚      1      â”‚    ptr3     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å€’æ’åˆ—è¡¨(Posting List):
è‹¹æœ â†’ [<æ–‡æ¡£1,ä½ç½®2,é¢‘ç‡1>, <æ–‡æ¡£3,ä½ç½®1,é¢‘ç‡1>]
æ‰‹æœº â†’ [<æ–‡æ¡£1,ä½ç½®3,é¢‘ç‡1>, <æ–‡æ¡£2,ä½ç½®2,é¢‘ç‡1>]
ä»·æ ¼ â†’ [<æ–‡æ¡£1,ä½ç½®4,é¢‘ç‡1>]
```

**ğŸ“Š è¯¦ç»†ä¿¡æ¯å­˜å‚¨**
æ¯ä¸ªå€’æ’åˆ—è¡¨é¡¹é€šå¸¸åŒ…å«ï¼š
- **æ–‡æ¡£ID**ï¼šå“ªä¸ªæ–‡æ¡£åŒ…å«è¿™ä¸ªè¯
- **è¯é¢‘(TF)**ï¼šè¯¥è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°æ¬¡æ•°
- **ä½ç½®ä¿¡æ¯**ï¼šè¯åœ¨æ–‡æ¡£ä¸­çš„å…·ä½“ä½ç½®
- **æƒé‡**ï¼šè¯¥è¯åœ¨æ–‡æ¡£ä¸­çš„é‡è¦ç¨‹åº¦

### 1.3 å€’æ’ç´¢å¼•å·¥ä½œæµç¨‹


**ğŸ”„ ç´¢å¼•æ„å»ºè¿‡ç¨‹**
```
åŸå§‹æ–‡æ¡£å¤„ç†æµç¨‹ï¼š

æ­¥éª¤1: æ–‡æ¡£é¢„å¤„ç†
åŸæ–‡ï¼š"è‹¹æœå…¬å¸å‘å¸ƒæ–°iPhoneæ‰‹æœº"
 â†“
åˆ†è¯ï¼š"è‹¹æœ" "å…¬å¸" "å‘å¸ƒ" "æ–°" "iPhone" "æ‰‹æœº"
 â†“  
å»åœç”¨è¯ï¼š"è‹¹æœ" "å…¬å¸" "iPhone" "æ‰‹æœº"
 â†“
è¯å¹²åŒ–/æ ‡å‡†åŒ–ï¼š"è‹¹æœ" "å…¬å¸" "iphone" "æ‰‹æœº"

æ­¥éª¤2: å»ºç«‹å€’æ’è¡¨
éå†æ‰€æœ‰å¤„ç†åçš„è¯æ±‡ï¼š
for each è¯æ±‡ in æ–‡æ¡£:
    if è¯æ±‡ not in è¯å…¸:
        åˆ›å»ºæ–°çš„å€’æ’åˆ—è¡¨
    æ·»åŠ æ–‡æ¡£ä¿¡æ¯åˆ°å€’æ’åˆ—è¡¨

æ­¥éª¤3: ç´¢å¼•ä¼˜åŒ–
- æŒ‰æ–‡æ¡£IDæ’åºå€’æ’åˆ—è¡¨
- å‹ç¼©å­˜å‚¨ç©ºé—´
- å»ºç«‹è·³è·ƒè¡¨åŠ é€ŸæŸ¥æ‰¾
```

---

## 2. âš¡ å€’æ’ç´¢å¼•ä¼˜åŒ–ç®—æ³•


### 2.1 å‹ç¼©å­˜å‚¨ä¼˜åŒ–


**ğŸ—œï¸ å·®å€¼ç¼–ç æŠ€æœ¯**
ç”±äºå€’æ’åˆ—è¡¨ä¸­çš„æ–‡æ¡£IDé€šå¸¸æ˜¯é€’å¢çš„ï¼Œå¯ä»¥ç”¨å·®å€¼è€Œä¸æ˜¯ç»å¯¹å€¼å­˜å‚¨ï¼Œå¤§å¤§èŠ‚çœç©ºé—´ã€‚

```
åŸå§‹æ–‡æ¡£IDåˆ—è¡¨ï¼š[5, 12, 23, 25, 47, 52]

å·®å€¼ç¼–ç åï¼š[5, 7, 11, 2, 22, 5]
å­˜å‚¨ç©ºé—´èŠ‚çœï¼šçº¦30-50%

å®ç°ç¤ºä¾‹ï¼š
```java
// å·®å€¼ç¼–ç å‹ç¼©
public class DeltaCompression {
    public static int[] compress(int[] docIds) {
        int[] compressed = new int[docIds.length];
        compressed[0] = docIds[0];  // ç¬¬ä¸€ä¸ªä¿æŒåŸå€¼
        
        for (int i = 1; i < docIds.length; i++) {
            compressed[i] = docIds[i] - docIds[i-1];  // å­˜å‚¨å·®å€¼
        }
        return compressed;
    }
    
    public static int[] decompress(int[] compressed) {
        int[] original = new int[compressed.length];
        original[0] = compressed[0];
        
        for (int i = 1; i < compressed.length; i++) {
            original[i] = original[i-1] + compressed[i];  // ç´¯åŠ è¿˜åŸ
        }
        return original;
    }
}
```

**ğŸ“¦ å˜é•¿ç¼–ç ä¼˜åŒ–**
```
Variable Byteç¼–ç ï¼š
å°æ•°å­—ç”¨æ›´å°‘å­—èŠ‚å­˜å‚¨ï¼Œå¤§æ•°å­—ç”¨æ›´å¤šå­—èŠ‚

æ•°å­—1-127ï¼š    ç”¨1ä¸ªå­—èŠ‚  (æœ€é«˜ä½ä¸º0)
æ•°å­—128-16383ï¼š ç”¨2ä¸ªå­—èŠ‚  (ç¬¬ä¸€ä¸ªå­—èŠ‚æœ€é«˜ä½ä¸º1)
æ•°å­—16384+ï¼š   ç”¨3+ä¸ªå­—èŠ‚

ç¤ºä¾‹ï¼š
æ•°å­—5    â†’ 00000101 (1å­—èŠ‚)
æ•°å­—200  â†’ 10000001 01001000 (2å­—èŠ‚)
æ•°å­—50000 â†’ 10000011 10000110 01010000 (3å­—èŠ‚)

ç©ºé—´èŠ‚çœï¼š20-40%
```

### 2.2 è·³è·ƒè¡¨åŠ é€ŸæŠ€æœ¯


**ğŸ¦˜ è·³è·ƒè¡¨ä¼˜åŒ–æŸ¥æ‰¾**
å½“å€’æ’åˆ—è¡¨å¾ˆé•¿æ—¶ï¼Œé¡ºåºæŸ¥æ‰¾æ•ˆç‡ä½ã€‚è·³è·ƒè¡¨å¯ä»¥å®ç°"è·³è·ƒå¼"æŸ¥æ‰¾ã€‚

```
æ™®é€šå€’æ’åˆ—è¡¨ï¼š
[1][5][12][23][25][47][52][67][89][102][134][156][189]

å¸¦è·³è·ƒè¡¨çš„å€’æ’åˆ—è¡¨ï¼š
å±‚çº§2: [1]--------[25]--------[89]--------[156]
å±‚çº§1: [1]---[12]---[25]---[52]---[89]---[134]---[156]
å±‚çº§0: [1][5][12][23][25][47][52][67][89][102][134][156][189]

æŸ¥æ‰¾67çš„è¿‡ç¨‹ï¼š
1. ä»å±‚çº§2å¼€å§‹ï¼š1 < 67 < 89ï¼Œè·³åˆ°25
2. åœ¨å±‚çº§1ï¼š25 < 67 < 89ï¼Œè·³åˆ°52  
3. åœ¨å±‚çº§0ï¼š52 < 67ï¼Œç»§ç»­åˆ°67ï¼Œæ‰¾åˆ°ï¼

æ—¶é—´å¤æ‚åº¦ï¼šO(log n) vs O(n)
```

**âš™ï¸ è·³è·ƒè¡¨å®ç°ä»£ç **
```java
public class SkipListNode {
    int docId;
    int skipDistance;  // è·³è·ƒè·ç¦»
    SkipListNode skip; // è·³è·ƒæŒ‡é’ˆ
    SkipListNode next; // æ™®é€šæŒ‡é’ˆ
    
    public SkipListNode(int docId) {
        this.docId = docId;
    }
}

public class InvertedIndexWithSkip {
    // æ„å»ºè·³è·ƒè¡¨
    public void buildSkipList(SkipListNode head, int skipDistance) {
        SkipListNode current = head;
        int count = 0;
        
        while (current != null) {
            if (count % skipDistance == 0 && current.next != null) {
                // è®¾ç½®è·³è·ƒæŒ‡é’ˆ
                SkipListNode skipTarget = current;
                for (int i = 0; i < skipDistance && skipTarget != null; i++) {
                    skipTarget = skipTarget.next;
                }
                current.skip = skipTarget;
                current.skipDistance = skipDistance;
            }
            current = current.next;
            count++;
        }
    }
    
    // ä½¿ç”¨è·³è·ƒè¡¨æŸ¥æ‰¾
    public boolean search(SkipListNode head, int targetDocId) {
        SkipListNode current = head;
        
        while (current != null) {
            // å¦‚æœå¯ä»¥è·³è·ƒä¸”è·³è·ƒåä»å°äºç›®æ ‡
            if (current.skip != null && current.skip.docId <= targetDocId) {
                current = current.skip;
            } else {
                // æ— æ³•è·³è·ƒï¼Œé€æ­¥å‰è¿›
                if (current.docId == targetDocId) {
                    return true;
                } else if (current.docId > targetDocId) {
                    return false;
                }
                current = current.next;
            }
        }
        return false;
    }
}
```

### 2.3 åˆ†å—ç´¢å¼•ä¼˜åŒ–


**ğŸ§© ç´¢å¼•åˆ†å—ç­–ç•¥**
å°†å¤§çš„å€’æ’ç´¢å¼•åˆ†æˆå¤šä¸ªå°å—ï¼Œæ¯å—ç‹¬ç«‹å¤„ç†ï¼Œæé«˜å¹¶è¡Œåº¦å’Œç¼“å­˜æ•ˆç‡ã€‚

```
å•å—ç´¢å¼•ç»“æ„ï¼š
å¤§ç´¢å¼•æ–‡ä»¶(1GB) â†’ æŸ¥è¯¢å»¶è¿Ÿé«˜ï¼Œå†…å­˜å ç”¨å¤§

åˆ†å—ç´¢å¼•ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å—1    â”‚  å—2    â”‚  å—3    â”‚  å—4    â”‚
â”‚ (256MB) â”‚ (256MB) â”‚ (256MB) â”‚ (256MB) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯å—åŒ…å«ï¼š
- ç‹¬ç«‹çš„è¯å…¸
- ç‹¬ç«‹çš„å€’æ’åˆ—è¡¨  
- å—çº§å…ƒæ•°æ®

ä¼˜åŠ¿ï¼š
âœ… å¹¶è¡ŒæŸ¥è¯¢ï¼šå¯ä»¥åŒæ—¶åœ¨å¤šä¸ªå—ä¸­æŸ¥æ‰¾
âœ… å†…å­˜å‹å¥½ï¼šåªåŠ è½½éœ€è¦çš„å—
âœ… æ›´æ–°é«˜æ•ˆï¼šåªéœ€é‡å»ºç›¸å…³å—
âœ… ç¼“å­˜ä¼˜åŒ–ï¼šçƒ­ç‚¹å—å¸¸é©»å†…å­˜
```

---

## 3. ğŸ¯ å¸ƒéš†è¿‡æ»¤å™¨æ ¸å¿ƒæœºåˆ¶


### 3.1 å¸ƒéš†è¿‡æ»¤å™¨å·¥ä½œåŸç†


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µç†è§£**
å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç©ºé—´æ•ˆç‡æé«˜çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚å®ƒå¯èƒ½äº§ç”Ÿè¯¯åˆ¤ï¼ˆè¯´å­˜åœ¨ä½†å®é™…ä¸å­˜åœ¨ï¼‰ï¼Œä½†ç»ä¸ä¼šæ¼åˆ¤ï¼ˆè¯´ä¸å­˜åœ¨å°±ä¸€å®šä¸å­˜åœ¨ï¼‰ã€‚

```
å¸ƒéš†è¿‡æ»¤å™¨ç»„æˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ä½æ•°ç»„(Bit Array)               â”‚
â”‚ [0][1][0][0][1][0][1][0][0][1][0][0]... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘
    å¤šä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„

å“ˆå¸Œå‡½æ•°ç»„ï¼š
hash1(x) = x % m
hash2(x) = (x * 7) % m  
hash3(x) = (x * 13) % m
```

**ğŸ”„ æ·»åŠ å…ƒç´ æµç¨‹**
```
æ·»åŠ å…ƒç´ "apple"ï¼š

æ­¥éª¤1: è®¡ç®—å“ˆå¸Œå€¼
hash1("apple") = 5
hash2("apple") = 11
hash3("apple") = 8

æ­¥éª¤2: è®¾ç½®å¯¹åº”ä½ä¸º1
ä½ç½®:  0  1  2  3  4  5  6  7  8  9 10 11 12
æ“ä½œå‰: 0  0  0  0  0  0  0  0  0  0  0  0  0
æ“ä½œå: 0  0  0  0  0  1  0  0  1  0  0  1  0
                     â†‘        â†‘        â†‘
                    pos5     pos8     pos11
```

**â“ æŸ¥è¯¢å…ƒç´ æµç¨‹**
```
æŸ¥è¯¢å…ƒç´ "apple"ï¼š

æ­¥éª¤1: è®¡ç®—ç›¸åŒå“ˆå¸Œå€¼
hash1("apple") = 5
hash2("apple") = 11  
hash3("apple") = 8

æ­¥éª¤2: æ£€æŸ¥å¯¹åº”ä½
æ£€æŸ¥ä½ç½®5: 1 âœ“
æ£€æŸ¥ä½ç½®11: 1 âœ“
æ£€æŸ¥ä½ç½®8: 1 âœ“

ç»“æœ: æ‰€æœ‰ä½éƒ½ä¸º1 â†’ å¯èƒ½å­˜åœ¨

æŸ¥è¯¢å…ƒç´ "orange"ï¼š
hash1("orange") = 3
hash2("orange") = 7
hash3("orange") = 2

æ£€æŸ¥ä½ç½®3: 0 âœ—
ç»“æœ: æœ‰ä½ä¸º0 â†’ ä¸€å®šä¸å­˜åœ¨ï¼ˆæ— éœ€æ£€æŸ¥å…¶ä»–ä½ï¼‰
```

### 3.2 è¯¯åˆ¤æœºåˆ¶åˆ†æ


**âš ï¸ å‡é˜³æ€§äº§ç”ŸåŸç†**
```
å‡é˜³æ€§åœºæ™¯ç¤ºä¾‹ï¼š

å·²æ·»åŠ å…ƒç´ : ["apple", "banana"] 
ä½æ•°ç»„çŠ¶æ€: [0][1][0][1][0][1][0][1][1][0][1][1][0]

æŸ¥è¯¢"grape":
hash1("grape") = 5 â†’ ä½ç½®5ä¸º1 (ç”±appleè®¾ç½®)
hash2("grape") = 11 â†’ ä½ç½®11ä¸º1 (ç”±bananaè®¾ç½®)  
hash3("grape") = 8 â†’ ä½ç½®8ä¸º1 (ç”±appleè®¾ç½®)

ç»“æœ: æ‰€æœ‰ä½éƒ½ä¸º1ï¼Œä½†"grape"å®é™…æœªæ·»åŠ 
è¿™å°±æ˜¯å‡é˜³æ€§ï¼

å…³é”®ç†è§£ï¼š
- ä¸åŒå…ƒç´ çš„å“ˆå¸Œå€¼å¯èƒ½ç¢°æ’åˆ°ç›¸åŒä½ç½®
- éšç€æ·»åŠ å…ƒç´ å¢å¤šï¼Œä½æ•°ç»„ä¸­1çš„æ¯”ä¾‹å¢åŠ 
- å‡é˜³æ€§æ¦‚ç‡éšä¹‹ä¸Šå‡
```

**ğŸ“Š å‡é˜³æ€§æ¦‚ç‡è®¡ç®—**
```
å‡é˜³æ€§æ¦‚ç‡å…¬å¼ï¼š
p = (1 - e^(-kn/m))^k

å…¶ä¸­ï¼š
- k: å“ˆå¸Œå‡½æ•°ä¸ªæ•°
- n: å·²æ’å…¥å…ƒç´ ä¸ªæ•°
- m: ä½æ•°ç»„å¤§å°
- e: è‡ªç„¶å¸¸æ•°

å®é™…ç¤ºä¾‹ï¼š
m = 1000 (ä½æ•°ç»„å¤§å°)
k = 3 (å“ˆå¸Œå‡½æ•°ä¸ªæ•°)
n = 100 (æ’å…¥100ä¸ªå…ƒç´ )

p = (1 - e^(-3Ã—100/1000))^3
  = (1 - e^(-0.3))^3  
  = (1 - 0.74)^3
  = 0.26^3
  â‰ˆ 0.018 (1.8%çš„å‡é˜³æ€§ç‡)
```

### 3.3 åœ¨å€’æ’ç´¢å¼•ä¸­çš„åº”ç”¨


**ğŸ¯ ç»“åˆåº”ç”¨åœºæ™¯**
```
ä¼ ç»Ÿå€’æ’ç´¢å¼•æŸ¥è¯¢æµç¨‹ï¼š
ç”¨æˆ·æœç´¢"æœºå™¨å­¦ä¹ " 
 â†“
æŸ¥æ‰¾è¯å…¸ä¸­çš„"æœºå™¨"å’Œ"å­¦ä¹ "
 â†“  
è¯»å–å¯¹åº”çš„å€’æ’åˆ—è¡¨
 â†“
è®¡ç®—äº¤é›†å¾—åˆ°ç»“æœæ–‡æ¡£

é—®é¢˜ï¼šè¯å…¸æŸ¥æ‰¾å¼€é”€å¤§ï¼ŒIOæ“ä½œé¢‘ç¹

å¸ƒéš†è¿‡æ»¤å™¨ä¼˜åŒ–æµç¨‹ï¼š
ç”¨æˆ·æœç´¢"æœºå™¨å­¦ä¹ "
 â†“
å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿæ£€æŸ¥"æœºå™¨"æ˜¯å¦å­˜åœ¨
 â†“
å¦‚æœè¿‡æ»¤å™¨è¿”å›"ä¸å­˜åœ¨" â†’ ç›´æ¥è¿”å›ç©ºç»“æœ
å¦‚æœè¿‡æ»¤å™¨è¿”å›"å¯èƒ½å­˜åœ¨" â†’ ç»§ç»­æŸ¥è¯¢è¯å…¸
 â†“
å‡å°‘æ— æ•ˆçš„è¯å…¸æŸ¥æ‰¾å’ŒIOæ“ä½œ

æ€§èƒ½æå‡ï¼š
- è¿‡æ»¤æ‰70-90%çš„æ— æ•ˆæŸ¥è¯¢
- å‡å°‘ç£ç›˜IOæ“ä½œ
- æå‡æŸ¥è¯¢å“åº”é€Ÿåº¦
```

---

## 4. ğŸ”§ å¸ƒéš†è¿‡æ»¤å™¨å‚æ•°è°ƒä¼˜


### 4.1 æ ¸å¿ƒå‚æ•°å…³ç³»åˆ†æ


**âš–ï¸ å…³é”®å‚æ•°ä¸‰è§’å…³ç³»**
```
å¸ƒéš†è¿‡æ»¤å™¨æ€§èƒ½ä¸‰è§’ï¼š

        å‡é˜³æ€§ç‡(p)
           â†—     â†–
          /         \
         /           \
   ä½æ•°ç»„å¤§å°(m) â†â†’ å“ˆå¸Œå‡½æ•°ä¸ªæ•°(k)
         \           /
          \         /
           â†˜     â†—
        å…ƒç´ ä¸ªæ•°(n)

æ ¸å¿ƒå…³ç³»ï¼š
- mè¶Šå¤§ â†’ pè¶Šå°ï¼Œä½†å†…å­˜å¼€é”€è¶Šå¤§
- kè¿‡å° â†’ å†²çªå¤šï¼Œpé«˜
- kè¿‡å¤§ â†’ è®¡ç®—å¼€é”€å¤§ï¼Œä½æ•°ç»„å¡«å……å¿«
- nå¢åŠ  â†’ pä¸Šå‡ï¼Œéœ€è¦å¢å¤§mæˆ–k
```

**ğŸ“ æœ€ä¼˜å‚æ•°è®¡ç®—å…¬å¼**
```
æœ€ä¼˜ä½æ•°ç»„å¤§å°ï¼š
m = -n Ã— ln(p) / (ln(2))Â²

æœ€ä¼˜å“ˆå¸Œå‡½æ•°ä¸ªæ•°ï¼š  
k = (m/n) Ã— ln(2) â‰ˆ 0.693 Ã— (m/n)

å®é™…è¯¯åˆ¤ç‡ï¼š
p_actual = (1 - e^(-kn/m))^k

å‚æ•°è®¡ç®—ç¤ºä¾‹ï¼š
ç›®æ ‡: 100ä¸‡ä¸ªå…ƒç´ ï¼Œ1%è¯¯åˆ¤ç‡

m = -1000000 Ã— ln(0.01) / (ln(2))Â²
  = -1000000 Ã— (-4.605) / 0.48
  â‰ˆ 9,600,000 ä½ â‰ˆ 1.2MB

k = 0.693 Ã— (9600000/1000000)
  â‰ˆ 6.7 â‰ˆ 7ä¸ªå“ˆå¸Œå‡½æ•°
```

### 4.2 å®é™…è°ƒä¼˜ç­–ç•¥


**ğŸ¯ åŸºäºä¸šåŠ¡åœºæ™¯çš„å‚æ•°é€‰æ‹©**

```
åœºæ™¯ä¸€ï¼šç½‘é¡µå»é‡ï¼ˆå¯¹è¯¯åˆ¤å®¹å¿åº¦é«˜ï¼‰
ä¸šåŠ¡éœ€æ±‚ï¼š
- é¢„æœŸå…ƒç´ ï¼š1äº¿ä¸ªURL
- å¯æ¥å—è¯¯åˆ¤ç‡ï¼š5%
- å†…å­˜é™åˆ¶ï¼šå°½é‡å°

å‚æ•°è®¡ç®—ï¼š
m = -100000000 Ã— ln(0.05) / (ln(2))Â²
  â‰ˆ 624MB
k â‰ˆ 4ä¸ªå“ˆå¸Œå‡½æ•°

å®é™…é…ç½®ï¼š
- ä½æ•°ç»„ï¼š512MB (ä¸ºäº†å¯¹é½ï¼Œç•¥å°äºç†è®ºå€¼)
- å“ˆå¸Œå‡½æ•°ï¼š4ä¸ª
- é¢„æœŸè¯¯åˆ¤ç‡ï¼šçº¦6%
- è¯„ä¼°ï¼šå¯æ¥å—çš„æƒè¡¡

åœºæ™¯äºŒï¼šæ•°æ®åº“æŸ¥è¯¢è¿‡æ»¤ï¼ˆå¯¹è¯¯åˆ¤æ•æ„Ÿï¼‰
ä¸šåŠ¡éœ€æ±‚ï¼š
- é¢„æœŸå…ƒç´ ï¼š1000ä¸‡ä¸ªä¸»é”®
- å¯æ¥å—è¯¯åˆ¤ç‡ï¼š0.1%
- æŸ¥è¯¢å»¶è¿Ÿï¼šä¼˜å…ˆè€ƒè™‘

å‚æ•°è®¡ç®—ï¼š
m = -10000000 Ã— ln(0.001) / (ln(2))Â²
  â‰ˆ 144MB  
k â‰ˆ 10ä¸ªå“ˆå¸Œå‡½æ•°

å®é™…é…ç½®ï¼š
- ä½æ•°ç»„ï¼š256MB (ç•™æœ‰ä½™é‡)
- å“ˆå¸Œå‡½æ•°ï¼š8ä¸ª (å‡å°‘è®¡ç®—å¼€é”€)
- é¢„æœŸè¯¯åˆ¤ç‡ï¼šçº¦0.05%
- è¯„ä¼°ï¼šæ€§èƒ½å’Œç²¾åº¦çš„å¹³è¡¡
```

**âš™ï¸ åŠ¨æ€å‚æ•°è°ƒæ•´**
```java
public class AdaptiveBloomFilter {
    private BitSet bitArray;
    private int expectedElements;
    private double targetFPP;
    private int currentElements;
    
    // åŠ¨æ€æ‰©å®¹ç­–ç•¥
    public void checkAndResize() {
        double currentFPP = calculateCurrentFPP();
        
        if (currentFPP > targetFPP * 1.5) {
            // è¯¯åˆ¤ç‡è¶…è¿‡ç›®æ ‡50%ï¼Œéœ€è¦æ‰©å®¹
            resize();
        }
    }
    
    private void resize() {
        // ä¿å­˜å½“å‰æ•°æ®
        Set<String> currentData = extractCurrentData();
        
        // è®¡ç®—æ–°å‚æ•°
        int newExpectedElements = expectedElements * 2;
        int newBitArraySize = optimalM(newExpectedElements, targetFPP);
        
        // é‡å»ºè¿‡æ»¤å™¨
        bitArray = new BitSet(newBitArraySize);
        expectedElements = newExpectedElements;
        currentElements = 0;
        
        // é‡æ–°æ·»åŠ æ•°æ®
        for (String item : currentData) {
            add(item);
        }
    }
    
    // è®¡ç®—å½“å‰è¯¯åˆ¤ç‡
    private double calculateCurrentFPP() {
        int setBits = bitArray.cardinality();
        double fillRatio = (double) setBits / bitArray.size();
        return Math.pow(fillRatio, hashFunctions);
    }
}
```

### 4.3 å¤šå±‚è¿‡æ»¤å™¨ä¼˜åŒ–


**ğŸ—ï¸ åˆ†å±‚è¿‡æ»¤å™¨æ¶æ„**
```
å¤šå±‚å¸ƒéš†è¿‡æ»¤å™¨è®¾è®¡ï¼š

ç¬¬ä¸€å±‚ï¼šç²—è¿‡æ»¤å™¨
â”œâ”€ å‚æ•°ï¼šè¾ƒå°çš„mï¼Œè¾ƒå°‘çš„k
â”œâ”€ ä½œç”¨ï¼šå¿«é€Ÿè¿‡æ»¤æ˜æ˜¾ä¸å­˜åœ¨çš„å…ƒç´   
â”œâ”€ å‡é˜³æ€§ç‡ï¼š10-20% (è¾ƒé«˜)
â””â”€ ä¼˜åŠ¿ï¼šæŸ¥è¯¢æå¿«ï¼Œå†…å­˜å ç”¨å°

ç¬¬äºŒå±‚ï¼šç²¾è¿‡æ»¤å™¨  
â”œâ”€ å‚æ•°ï¼šè¾ƒå¤§çš„mï¼Œè¾ƒå¤šçš„k
â”œâ”€ ä½œç”¨ï¼šè¿›ä¸€æ­¥è¿‡æ»¤
â”œâ”€ å‡é˜³æ€§ç‡ï¼š1-5% (ä¸­ç­‰)
â””â”€ ä¼˜åŠ¿ï¼šå¹³è¡¡ç²¾åº¦å’Œæ€§èƒ½

ç¬¬ä¸‰å±‚ï¼šç²¾ç¡®æŸ¥è¯¢
â”œâ”€ ä½œç”¨ï¼šæœ€ç»ˆç¡®è®¤
â”œâ”€ æ–¹æ³•ï¼šæŸ¥è¯¢åŸå§‹æ•°æ®ç»“æ„
â”œâ”€ å‡é˜³æ€§ç‡ï¼š0% (ç»å¯¹å‡†ç¡®)
â””â”€ ä¼˜åŠ¿ï¼šä¿è¯ç»“æœæ­£ç¡®æ€§

æŸ¥è¯¢æµç¨‹ï¼š
å…ƒç´ æŸ¥è¯¢ â†’ ç¬¬ä¸€å±‚è¿‡æ»¤ â†’ ç¬¬äºŒå±‚è¿‡æ»¤ â†’ ç²¾ç¡®æŸ¥è¯¢
         (90%è¿‡æ»¤)    (5%è¿‡æ»¤)     (å‰©ä½™5%)

æ€»ä½“æ•ˆæœï¼š
- 95%çš„æŸ¥è¯¢åœ¨å‰ä¸¤å±‚å°±è¢«è¿‡æ»¤
- åªæœ‰5%éœ€è¦è¿›è¡Œæ˜‚è´µçš„ç²¾ç¡®æŸ¥è¯¢
- æ•´ä½“æ€§èƒ½æå‡80%ä»¥ä¸Š
```

---

## 5. ğŸ›ï¸ å‡é˜³æ€§æ§åˆ¶ç­–ç•¥


### 5.1 å‡é˜³æ€§ç‡ç›‘æ§


**ğŸ“Š å®æ—¶ç›‘æ§æŒ‡æ ‡**
```
ç›‘æ§æŒ‡æ ‡ä½“ç³»ï¼š

åŸºç¡€æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æŒ‡æ ‡åç§°     â”‚    è®¡ç®—å…¬å¼  â”‚   å‘Šè­¦é˜ˆå€¼   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç†è®ºå‡é˜³æ€§ç‡    â”‚  å…¬å¼è®¡ç®—    â”‚     N/A     â”‚
â”‚ å®é™…å‡é˜³æ€§ç‡    â”‚  æµ‹è¯•ç»Ÿè®¡    â”‚  > ç†è®ºÃ—1.5  â”‚
â”‚ ä½æ•°ç»„å¡«å……ç‡    â”‚ setBits/totalâ”‚    > 0.5    â”‚
â”‚ æŸ¥è¯¢å‘½ä¸­ç‡      â”‚  hit/total   â”‚    < 0.3    â”‚
â”‚ è¿‡æ»¤æ•ˆç‡       â”‚ filter/total â”‚    < 0.7    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç›‘æ§å®ç°ï¼š
```java
public class BloomFilterMonitor {
    private BloomFilter filter;
    private AtomicLong totalQueries = new AtomicLong(0);
    private AtomicLong falsePositives = new AtomicLong(0);
    private AtomicLong trueNegatives = new AtomicLong(0);
    
    public void recordQuery(String item, boolean bloomResult, boolean actualResult) {
        totalQueries.incrementAndGet();
        
        if (bloomResult && !actualResult) {
            // å¸ƒéš†è¿‡æ»¤å™¨è¯´å­˜åœ¨ï¼Œä½†å®é™…ä¸å­˜åœ¨ â†’ å‡é˜³æ€§
            falsePositives.incrementAndGet();
        } else if (!bloomResult && !actualResult) {
            // å¸ƒéš†è¿‡æ»¤å™¨è¯´ä¸å­˜åœ¨ï¼Œå®é™…ä¹Ÿä¸å­˜åœ¨ â†’ çœŸé˜´æ€§
            trueNegatives.incrementAndGet();
        }
    }
    
    public double getCurrentFPP() {
        long total = totalQueries.get();
        if (total == 0) return 0.0;
        
        return (double) falsePositives.get() / total;
    }
    
    public double getFilterEfficiency() {
        long total = totalQueries.get();
        if (total == 0) return 0.0;
        
        return (double) trueNegatives.get() / total;
    }
}
```

### 5.2 è‡ªé€‚åº”ç²¾åº¦æ§åˆ¶


**ğŸ¯ åŠ¨æ€ç²¾åº¦è°ƒæ•´æœºåˆ¶**
```
è‡ªé€‚åº”æ§åˆ¶ç­–ç•¥ï¼š

ç²¾åº¦ç­‰çº§åˆ†ç±»ï¼š
é«˜ç²¾åº¦æ¨¡å¼ (FPP < 0.1%)
â”œâ”€ é€‚ç”¨ï¼šé‡‘èäº¤æ˜“ã€å®‰å…¨è®¤è¯
â”œâ”€ é…ç½®ï¼šå¤§ä½æ•°ç»„ + å¤šå“ˆå¸Œå‡½æ•°
â”œâ”€ ä»£ä»·ï¼šå†…å­˜å’Œè®¡ç®—å¼€é”€å¤§
â””â”€ åˆ‡æ¢æ¡ä»¶ï¼šä¸šåŠ¡å…³é”®æ—¶æ®µ

æ ‡å‡†æ¨¡å¼ (FPP 1-5%)
â”œâ”€ é€‚ç”¨ï¼šä¸€èˆ¬ä¸šåŠ¡æŸ¥è¯¢
â”œâ”€ é…ç½®ï¼šå¹³è¡¡çš„å‚æ•°è®¾ç½®
â”œâ”€ ä»£ä»·ï¼šä¸­ç­‰èµ„æºæ¶ˆè€—
â””â”€ åˆ‡æ¢æ¡ä»¶ï¼šæ­£å¸¸ä¸šåŠ¡æ—¶æ®µ

é«˜æ•ˆæ¨¡å¼ (FPP 5-10%)
â”œâ”€ é€‚ç”¨ï¼šæ—¥å¿—åˆ†æã€ç»Ÿè®¡è®¡ç®—
â”œâ”€ é…ç½®ï¼šå°ä½æ•°ç»„ + å°‘å“ˆå¸Œå‡½æ•°
â”œâ”€ ä»£ä»·ï¼šèµ„æºæ¶ˆè€—æœ€å°
â””â”€ åˆ‡æ¢æ¡ä»¶ï¼šé«˜å¹¶å‘æ—¶æ®µ

åŠ¨æ€åˆ‡æ¢é€»è¾‘ï¼š
```java
public class AdaptivePrecisionBloomFilter {
    private enum PrecisionMode {
        HIGH(0.001, 15, 2.0),      // 0.1%è¯¯åˆ¤ç‡ï¼Œ15ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œ2å€å†…å­˜
        STANDARD(0.01, 7, 1.0),    // 1%è¯¯åˆ¤ç‡ï¼Œ7ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæ ‡å‡†å†…å­˜
        EFFICIENT(0.05, 4, 0.5);   // 5%è¯¯åˆ¤ç‡ï¼Œ4ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œ0.5å€å†…å­˜
        
        final double fpp;
        final int hashCount;
        final double memoryMultiplier;
        
        PrecisionMode(double fpp, int hashCount, double memoryMultiplier) {
            this.fpp = fpp;
            this.hashCount = hashCount;
            this.memoryMultiplier = memoryMultiplier;
        }
    }
    
    private PrecisionMode currentMode = PrecisionMode.STANDARD;
    private BloomFilterMonitor monitor;
    
    public void adjustPrecision() {
        double currentLoad = getCurrentSystemLoad();
        double actualFPP = monitor.getCurrentFPP();
        double targetFPP = currentMode.fpp;
        
        // åŸºäºç³»ç»Ÿè´Ÿè½½è°ƒæ•´
        if (currentLoad > 0.8 && currentMode != PrecisionMode.EFFICIENT) {
            switchToMode(PrecisionMode.EFFICIENT);
        } else if (currentLoad < 0.3 && actualFPP > targetFPP * 2) {
            switchToMode(PrecisionMode.HIGH);
        }
    }
    
    private void switchToMode(PrecisionMode newMode) {
        if (newMode == currentMode) return;
        
        // æ¸è¿›å¼åˆ‡æ¢ï¼Œé¿å…æœåŠ¡ä¸­æ–­
        BloomFilter newFilter = createFilterWithMode(newMode);
        migrateData(newFilter);
        this.currentMode = newMode;
    }
}
```

### 5.3 åˆ†çº§éªŒè¯ç­–ç•¥


**ğŸ” å¤šçº§éªŒè¯æœºåˆ¶**
```
éªŒè¯çº§åˆ«è®¾è®¡ï¼š

Level 0: å¸ƒéš†è¿‡æ»¤å™¨åˆç­›
â”œâ”€ ç›®æ ‡ï¼šè¿‡æ»¤90%+çš„æ˜ç¡®ä¸å­˜åœ¨é¡¹
â”œâ”€ é€Ÿåº¦ï¼šæå¿« (<1ms)
â”œâ”€ å‡†ç¡®ç‡ï¼šå‡é˜³æ€§å¯èƒ½ï¼Œä½†æ— å‡é˜´æ€§
â””â”€ ä¸‹ä¸€æ­¥ï¼šé€šè¿‡åˆ™è¿›å…¥Level 1

Level 1: ç¼“å­˜å¿«é€ŸéªŒè¯
â”œâ”€ ç›®æ ‡ï¼šåœ¨å†…å­˜ä¸­å¿«é€Ÿç¡®è®¤çƒ­ç‚¹æ•°æ®
â”œâ”€ é€Ÿåº¦ï¼šå¾ˆå¿« (1-5ms)  
â”œâ”€ å‡†ç¡®ç‡ï¼šç¼“å­˜å‘½ä¸­åˆ™100%å‡†ç¡®
â””â”€ ä¸‹ä¸€æ­¥ï¼šæœªå‘½ä¸­åˆ™è¿›å…¥Level 2

Level 2: ç´¢å¼•ç»“æ„éªŒè¯
â”œâ”€ ç›®æ ‡ï¼šé€šè¿‡ç´¢å¼•å¿«é€ŸæŸ¥æ‰¾
â”œâ”€ é€Ÿåº¦ï¼šå¿« (5-20ms)
â”œâ”€ å‡†ç¡®ç‡ï¼š100%å‡†ç¡®
â””â”€ ä¸‹ä¸€æ­¥ï¼šæœªæ‰¾åˆ°åˆ™è¿›å…¥Level 3

Level 3: å®Œæ•´æ•°æ®éªŒè¯
â”œâ”€ ç›®æ ‡ï¼šæœ€ç»ˆç¡®è®¤ç»“æœ
â”œâ”€ é€Ÿåº¦ï¼šè¾ƒæ…¢ (20ms+)
â”œâ”€ å‡†ç¡®ç‡ï¼š100%å‡†ç¡®ï¼Œæƒå¨ç»“æœ
â””â”€ ç»“æœï¼šè¿”å›æœ€ç»ˆç­”æ¡ˆ

å®ç°ç¤ºä¾‹ï¼š
```java
public class TieredVerificationSystem {
    private BloomFilter bloomFilter;
    private LRUCache<String, Boolean> hotCache;
    private IndexStructure indexStructure;
    private DataStorage storage;
    
    public boolean exists(String item) {
        // Level 0: å¸ƒéš†è¿‡æ»¤å™¨
        if (!bloomFilter.mightContain(item)) {
            recordMetric("bloom_filter_negative", 1);
            return false;  // ç¡®å®šä¸å­˜åœ¨
        }
        recordMetric("bloom_filter_positive", 1);
        
        // Level 1: çƒ­ç‚¹ç¼“å­˜
        Boolean cached = hotCache.get(item);
        if (cached != null) {
            recordMetric("cache_hit", 1);
            return cached;
        }
        recordMetric("cache_miss", 1);
        
        // Level 2: ç´¢å¼•æŸ¥æ‰¾
        boolean indexResult = indexStructure.contains(item);
        if (!indexResult) {
            hotCache.put(item, false);  // ç¼“å­˜å¦å®šç»“æœ
            recordMetric("index_negative", 1);
            return false;
        }
        recordMetric("index_positive", 1);
        
        // Level 3: å®Œæ•´éªŒè¯
        boolean finalResult = storage.contains(item);
        hotCache.put(item, finalResult);  // ç¼“å­˜æœ€ç»ˆç»“æœ
        recordMetric("storage_query", 1);
        
        return finalResult;
    }
}
```

---

## 6. ğŸ“ˆ è¿‡æ»¤å™¨å‘½ä¸­ç‡ä¼˜åŒ–


### 6.1 å‘½ä¸­ç‡åˆ†ææ¡†æ¶


**ğŸ“Š å‘½ä¸­ç‡æŒ‡æ ‡ä½“ç³»**
```
å‘½ä¸­ç‡è®¡ç®—å…¬å¼ï¼š

å¸ƒéš†è¿‡æ»¤å™¨å‘½ä¸­ç‡ = æ­£ç¡®è¿‡æ»¤çš„æŸ¥è¯¢æ•° / æ€»æŸ¥è¯¢æ•°

è¯¦ç»†åˆ†è§£ï¼š
çœŸé˜´æ€§ç‡ = æ­£ç¡®è¯†åˆ«ä¸å­˜åœ¨çš„å…ƒç´ æ•° / å®é™…ä¸å­˜åœ¨çš„å…ƒç´ æ•°
å‡é˜³æ€§ç‡ = é”™è¯¯è¯†åˆ«ä¸ºå­˜åœ¨çš„å…ƒç´ æ•° / å®é™…ä¸å­˜åœ¨çš„å…ƒç´ æ•°  
çœŸé˜³æ€§ç‡ = æ­£ç¡®è¯†åˆ«å­˜åœ¨çš„å…ƒç´ æ•° / å®é™…å­˜åœ¨çš„å…ƒç´ æ•°

è¿‡æ»¤æ•ˆç‡ = (çœŸé˜´æ€§æ•°é‡ + çœŸé˜³æ€§æ•°é‡) / æ€»æŸ¥è¯¢æ•°

æ€§èƒ½æŒ‡æ ‡è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æŸ¥è¯¢ç»“æœ     â”‚ å®é™…å­˜åœ¨ â”‚ å®é™…ä¸å­˜åœ¨â”‚     æ€»è®¡     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿‡æ»¤å™¨è¿”å›å­˜åœ¨   â”‚   TP    â”‚   FP    â”‚   TP + FP   â”‚
â”‚ è¿‡æ»¤å™¨è¿”å›ä¸å­˜åœ¨ â”‚    0    â”‚   TN    â”‚     TN      â”‚
â”‚      æ€»è®¡       â”‚   TP    â”‚ FP + TN â”‚     æ€»æ•°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŒ–ç›®æ ‡ï¼š
- æœ€å¤§åŒ– TN (çœŸé˜´æ€§)ï¼šæ­£ç¡®è¿‡æ»¤ä¸å­˜åœ¨çš„å…ƒç´ 
- æœ€å°åŒ– FP (å‡é˜³æ€§)ï¼šå‡å°‘è¯¯åˆ¤
- ä¿æŒ TP = å®é™…å­˜åœ¨æ•°ï¼šä¸èƒ½æ¼æ‰å­˜åœ¨çš„å…ƒç´ 
```

### 6.2 æ•°æ®åˆ†å¸ƒä¼˜åŒ–


**ğŸ¯ åŸºäºè®¿é—®æ¨¡å¼çš„ä¼˜åŒ–**
```
è®¿é—®æ¨¡å¼åˆ†æï¼š

çƒ­ç‚¹æ•°æ®è¯†åˆ«ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®ç±»å‹   â”‚  è®¿é—®é¢‘ç‡ â”‚  è¯¯åˆ¤æˆæœ¬ â”‚   ä¼˜åŒ–ç­–ç•¥    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   çƒ­ç‚¹æŸ¥è¯¢   â”‚    é«˜    â”‚    é«˜    â”‚ ä¸“ç”¨é«˜ç²¾åº¦è¿‡æ»¤å™¨â”‚
â”‚   é•¿å°¾æŸ¥è¯¢   â”‚    ä½    â”‚    ä½    â”‚  æ ‡å‡†è¿‡æ»¤å™¨   â”‚
â”‚   æ‰¹é‡æŸ¥è¯¢   â”‚   ä¸­ç­‰   â”‚   ä¸­ç­‰   â”‚   åˆ†æ‰¹ä¼˜åŒ–    â”‚
â”‚   å®æ—¶æŸ¥è¯¢   â”‚    é«˜    â”‚    é«˜    â”‚   å¤šçº§ç¼“å­˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†å±‚è¿‡æ»¤å™¨è®¾è®¡ï¼š
```java
public class HierarchicalBloomFilter {
    // çƒ­ç‚¹æ•°æ®é«˜ç²¾åº¦è¿‡æ»¤å™¨
    private BloomFilter hotDataFilter;     // FPP: 0.1%
    
    // æ™®é€šæ•°æ®æ ‡å‡†è¿‡æ»¤å™¨  
    private BloomFilter standardFilter;    // FPP: 1%
    
    // å†·æ•°æ®ä½ç²¾åº¦è¿‡æ»¤å™¨
    private BloomFilter coldDataFilter;    // FPP: 5%
    
    // çƒ­ç‚¹æ•°æ®è¯†åˆ«å™¨
    private HotDataDetector hotDetector;
    
    public boolean mightContain(String item) {
        // é¦–å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºçƒ­ç‚¹æ•°æ®
        DataTemperature temp = hotDetector.getTemperature(item);
        
        switch (temp) {
            case HOT:
                return hotDataFilter.mightContain(item);
            case WARM:
                return standardFilter.mightContain(item);
            case COLD:
                return coldDataFilter.mightContain(item);
            default:
                return standardFilter.mightContain(item);
        }
    }
    
    public void add(String item) {
        // æ ¹æ®æ•°æ®æ¸©åº¦æ·»åŠ åˆ°å¯¹åº”è¿‡æ»¤å™¨
        DataTemperature temp = hotDetector.detectAndRecord(item);
        
        if (temp == DataTemperature.HOT) {
            hotDataFilter.add(item);
        }
        // åŒæ—¶æ·»åŠ åˆ°æ ‡å‡†è¿‡æ»¤å™¨ä½œä¸ºå¤‡ä»½
        standardFilter.add(item);
        
        if (temp == DataTemperature.COLD) {
            coldDataFilter.add(item);
        }
    }
}
```

### 6.3 å“ˆå¸Œå‡½æ•°ä¼˜åŒ–


**âš¡ é«˜æ•ˆå“ˆå¸Œå‡½æ•°é€‰æ‹©**
```
å“ˆå¸Œå‡½æ•°æ€§èƒ½å¯¹æ¯”ï¼š

MurmurHash3ï¼š
â”œâ”€ æ€§èƒ½ï¼šæå¿«
â”œâ”€ åˆ†å¸ƒï¼šå‡åŒ€æ€§å¥½
â”œâ”€ ç¢°æ’ç‡ï¼šä½
â””â”€ æ¨èï¼šé«˜å¹¶å‘åœºæ™¯

FNV Hashï¼š
â”œâ”€ æ€§èƒ½ï¼šå¿«
â”œâ”€ åˆ†å¸ƒï¼šè‰¯å¥½
â”œâ”€ å®ç°ï¼šç®€å•
â””â”€ æ¨èï¼šä¸€èˆ¬åœºæ™¯

SHA-1 (éƒ¨åˆ†)ï¼š
â”œâ”€ æ€§èƒ½ï¼šè¾ƒæ…¢
â”œâ”€ åˆ†å¸ƒï¼šæä½³
â”œâ”€ å®‰å…¨æ€§ï¼šé«˜
â””â”€ æ¨èï¼šå®‰å…¨è¦æ±‚é«˜çš„åœºæ™¯

åŒé‡å“ˆå¸Œå®ç°ï¼š
```java
public class OptimizedHashFunctions {
    
    // ä½¿ç”¨MurmurHash3çš„åŒé‡å“ˆå¸Œ
    public static class DoubleHash {
        private final int seed1 = 0x1234ABCD;
        private final int seed2 = 0xABCD1234;
        
        public int[] getHashes(String item, int numHashes, int arraySize) {
            byte[] bytes = item.getBytes(StandardCharsets.UTF_8);
            
            // è®¡ç®—ä¸¤ä¸ªåŸºç¡€å“ˆå¸Œå€¼
            int hash1 = MurmurHash3.hash32(bytes, seed1);
            int hash2 = MurmurHash3.hash32(bytes, seed2);
            
            int[] hashes = new int[numHashes];
            
            // åŒé‡å“ˆå¸Œç”Ÿæˆå¤šä¸ªå“ˆå¸Œå€¼
            for (int i = 0; i < numHashes; i++) {
                hashes[i] = Math.abs((hash1 + i * hash2) % arraySize);
            }
            
            return hashes;
        }
    }
    
    // ä½æ“ä½œä¼˜åŒ–çš„å“ˆå¸Œå‡½æ•°
    public static class FastBitHash {
        private static final long LARGE_PRIME = 1099511628211L;
        
        public int fastHash(String item, int seed, int arraySize) {
            long hash = seed;
            byte[] bytes = item.getBytes();
            
            for (byte b : bytes) {
                hash ^= b;
                hash *= LARGE_PRIME;
            }
            
            // ä½¿ç”¨ä½æ“ä½œä¼˜åŒ–å–æ¨¡è¿ç®—
            if (isPowerOfTwo(arraySize)) {
                return (int) (hash & (arraySize - 1));
            } else {
                return (int) (Math.abs(hash) % arraySize);
            }
        }
        
        private boolean isPowerOfTwo(int n) {
            return n > 0 && (n & (n - 1)) == 0;
        }
    }
}
```

**ğŸ”§ å“ˆå¸Œå‡½æ•°è´¨é‡éªŒè¯**
```java
public class HashQualityTester {
    
    // æµ‹è¯•å“ˆå¸Œåˆ†å¸ƒå‡åŒ€æ€§
    public double testDistribution(HashFunction hashFunc, List<String> testData, int arraySize) {
        int[] buckets = new int[arraySize];
        
        for (String item : testData) {
            int hash = hashFunc.hash(item, arraySize);
            buckets[hash]++;
        }
        
        // è®¡ç®—å¡æ–¹ç»Ÿè®¡é‡
        double expected = (double) testData.size() / arraySize;
        double chiSquare = 0.0;
        
        for (int count : buckets) {
            double diff = count - expected;
            chiSquare += (diff * diff) / expected;
        }
        
        return chiSquare;  // è¶Šå°è¶Šå‡åŒ€
    }
    
    // æµ‹è¯•å“ˆå¸Œç¢°æ’ç‡
    public double testCollisionRate(HashFunction hashFunc, List<String> testData, int arraySize) {
        Set<Integer> uniqueHashes = new HashSet<>();
        
        for (String item : testData) {
            uniqueHashes.add(hashFunc.hash(item, arraySize));
        }
        
        int collisions = testData.size() - uniqueHashes.size();
        return (double) collisions / testData.size();
    }
}
```

---

## 7. ğŸ’¾ å†…å­˜ä½¿ç”¨ä¼˜åŒ–æŠ€æœ¯


### 7.1 å†…å­˜å¸ƒå±€ä¼˜åŒ–


**ğŸ—ï¸ é«˜æ•ˆå†…å­˜ç»“æ„è®¾è®¡**
```
ä¼ ç»Ÿä½æ•°ç»„å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Java BitSet (ä½¿ç”¨long[]æ•°ç»„å­˜å‚¨)        â”‚
â”‚  [long1][long2][long3]...[longN]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å†…å­˜å¼€é”€ï¼šæ¯ä½å®é™…å ç”¨çº¦1.05ä½ (æœ‰å…ƒæ•°æ®å¼€é”€)

ä¼˜åŒ–ä½æ•°ç»„å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     è‡ªå®šä¹‰ç´§å‡‘ä½æ•°ç»„                     â”‚
â”‚  header(8å­—èŠ‚) + data(çº¯ä½æ•°æ®)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å†…å­˜å¼€é”€ï¼šæ¯ä½å ç”¨1.0001ä½ (å‡ ä¹æ— å¼€é”€)

å†…å­˜å¯¹é½ä¼˜åŒ–ï¼š
```java
public class CompactBitArray {
    private final byte[] data;
    private final int bitCount;
    private final int byteCount;
    
    public CompactBitArray(int bitCount) {
        this.bitCount = bitCount;
        this.byteCount = (bitCount + 7) / 8;  // å‘ä¸Šå–æ•´åˆ°å­—èŠ‚
        this.data = new byte[byteCount];
    }
    
    public void setBit(int index) {
        if (index >= bitCount) throw new IndexOutOfBoundsException();
        
        int byteIndex = index / 8;
        int bitIndex = index % 8;
        data[byteIndex] |= (1 << bitIndex);
    }
    
    public boolean getBit(int index) {
        if (index >= bitCount) throw new IndexOutOfBoundsException();
        
        int byteIndex = index / 8;
        int bitIndex = index % 8;
        return (data[byteIndex] & (1 << bitIndex)) != 0;
    }
    
    // æ‰¹é‡æ“ä½œä¼˜åŒ–
    public void setBits(int[] indices) {
        for (int index : indices) {
            int byteIndex = index / 8;
            int bitIndex = index % 8;
            data[byteIndex] |= (1 << bitIndex);
        }
    }
    
    // å†…å­˜ä½¿ç”¨ç»Ÿè®¡
    public long getMemoryUsage() {
        return 16 + byteCount;  // å¯¹è±¡å¤´ + æ•°ç»„æ•°æ®
    }
}
```

### 7.2 å‹ç¼©å­˜å‚¨æŠ€æœ¯


**ğŸ—œï¸ ç¨€ç–ä½æ•°ç»„å‹ç¼©**
```
ç¨€ç–æ•°æ®å‹ç¼©ç­–ç•¥ï¼š

RLE (Run-Length Encoding) å‹ç¼©ï¼š
åŸå§‹æ•°æ®ï¼š000001111100000111000...
RLEç¼–ç ï¼š (5,0)(5,1)(5,0)(3,1)(3,0)...
å‹ç¼©æ¯”ä¾‹ï¼šç¨€ç–åº¦é«˜æ—¶å¯è¾¾10:1

ä½å›¾å‹ç¼©ï¼ˆRoaring Bitmapï¼‰ï¼š
åˆ†å—å­˜å‚¨ï¼šå°†ä½æ•°ç»„åˆ†æˆ64KBå—
- ç¨€ç–å—ï¼šä½¿ç”¨æœ‰åºæ•°ç»„å­˜å‚¨
- å¯†é›†å—ï¼šä½¿ç”¨ä½å›¾å­˜å‚¨  
- ä¸­ç­‰å—ï¼šä½¿ç”¨RLEå‹ç¼©

å®ç°ç¤ºä¾‹ï¼š
```java
public class CompressedBloomFilter {
    private final RoaringBitmap bitmap;
    private final int hashFunctions;
    
    public CompressedBloomFilter(int expectedElements, double fpp) {
        this.bitmap = new RoaringBitmap();
        this.hashFunctions = optimalHashFunctions(expectedElements, fpp);
    }
    
    public void add(String item) {
        int[] hashes = computeHashes(item);
        for (int hash : hashes) {
            bitmap.add(hash);
        }
    }
    
    public boolean mightContain(String item) {
        int[] hashes = computeHashes(item);
        for (int hash : hashes) {
            if (!bitmap.contains(hash)) {
                return false;
            }
        }
        return true;
    }
    
    // å†…å­˜ä½¿ç”¨ä¼˜åŒ–
    public void optimize() {
        bitmap.runOptimize();  // è¿è¡Œä¼˜åŒ–å‹ç¼©
    }
    
    public long getCompressedSize() {
        return bitmap.getSizeInBytes();
    }
    
    public double getCompressionRatio() {
        long uncompressedSize = bitmap.getCardinality() / 8;  // ç†è®ºä½æ•°ç»„å¤§å°
        long compressedSize = bitmap.getSizeInBytes();
        return (double) uncompressedSize / compressedSize;
    }
}
```

### 7.3 å†…å­˜æ± åŒ–ç®¡ç†


**ğŸŠ å†…å­˜æ± ä¼˜åŒ–ç­–ç•¥**
```
å†…å­˜æ± åŒ–è®¾è®¡ï¼š

é¢„åˆ†é…ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å†…å­˜æ±                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1MBå—   â”‚ â”‚ 1MBå—   â”‚ â”‚ 1MBå—   â”‚... â”‚
â”‚  â”‚ (ç©ºé—²)  â”‚ â”‚ (ä½¿ç”¨ä¸­) â”‚ â”‚ (ç©ºé—²)  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¤ç”¨ç­–ç•¥ï¼š
- è¿‡æ»¤å™¨é”€æ¯æ—¶ï¼Œå†…å­˜å—å›å½’æ± ä¸­
- æ–°è¿‡æ»¤å™¨åˆ›å»ºæ—¶ï¼Œä»æ± ä¸­è·å–
- é¿å…é¢‘ç¹çš„å†…å­˜åˆ†é…/é‡Šæ”¾

å®ç°ç¤ºä¾‹ï¼š
```java
public class BloomFilterMemoryPool {
    private final Queue<byte[]> availableBlocks;
    private final int blockSize;
    private final int maxPoolSize;
    private final AtomicInteger currentPoolSize;
    
    public BloomFilterMemoryPool(int blockSize, int maxPoolSize) {
        this.availableBlocks = new ConcurrentLinkedQueue<>();
        this.blockSize = blockSize;
        this.maxPoolSize = maxPoolSize;
        this.currentPoolSize = new AtomicInteger(0);
        
        // é¢„åˆ†é…ä¸€äº›å†…å­˜å—
        preAllocateBlocks(maxPoolSize / 2);
    }
    
    public byte[] acquireBlock() {
        byte[] block = availableBlocks.poll();
        if (block == null) {
            // æ± ä¸­æ— å¯ç”¨å—ï¼Œç›´æ¥åˆ†é…
            block = new byte[blockSize];
        } else {
            // æ¸…é›¶å¤ç”¨çš„å†…å­˜å—
            Arrays.fill(block, (byte) 0);
        }
        return block;
    }
    
    public void releaseBlock(byte[] block) {
        if (block.length != blockSize) return;
        
        if (currentPoolSize.get() < maxPoolSize) {
            availableBlocks.offer(block);
            currentPoolSize.incrementAndGet();
        }
        // è¶…è¿‡æ± å¤§å°é™åˆ¶çš„å—è¢«GCå›æ”¶
    }
    
    private void preAllocateBlocks(int count) {
        for (int i = 0; i < count; i++) {
            availableBlocks.offer(new byte[blockSize]);
            currentPoolSize.incrementAndGet();
        }
    }
    
    // æ± çŠ¶æ€ç›‘æ§
    public PoolStats getStats() {
        return new PoolStats(
            availableBlocks.size(),
            currentPoolSize.get(),
            maxPoolSize
        );
    }
}

// ä½¿ç”¨å†…å­˜æ± çš„å¸ƒéš†è¿‡æ»¤å™¨
public class PooledBloomFilter {
    private final BloomFilterMemoryPool memoryPool;
    private byte[] bitArray;
    
    public PooledBloomFilter(BloomFilterMemoryPool pool, int bitArraySize) {
        this.memoryPool = pool;
        this.bitArray = pool.acquireBlock();
        
        if (bitArray.length < bitArraySize) {
            // æ± ä¸­çš„å—å¤ªå°ï¼Œéœ€è¦ç›´æ¥åˆ†é…
            pool.releaseBlock(bitArray);
            bitArray = new byte[bitArraySize];
        }
    }
    
    public void close() {
        if (bitArray != null) {
            memoryPool.releaseBlock(bitArray);
            bitArray = null;
        }
    }
}
```

---

## 8. ğŸŒ å¤§æ•°æ®åœºæ™¯åº”ç”¨å®è·µ


### 8.1 åˆ†å¸ƒå¼å¸ƒéš†è¿‡æ»¤å™¨


**ğŸŒ åˆ†å¸ƒå¼æ¶æ„è®¾è®¡**
```
åˆ†å¸ƒå¼éƒ¨ç½²æ¨¡å¼ï¼š

æ¨¡å¼ä¸€ï¼šå¤åˆ¶æ¨¡å¼ï¼ˆé«˜å¯ç”¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   èŠ‚ç‚¹A     â”‚    â”‚   èŠ‚ç‚¹B     â”‚    â”‚   èŠ‚ç‚¹C     â”‚
â”‚ å®Œæ•´è¿‡æ»¤å™¨   â”‚    â”‚ å®Œæ•´è¿‡æ»¤å™¨   â”‚    â”‚ å®Œæ•´è¿‡æ»¤å™¨   â”‚
â”‚  (å‰¯æœ¬1)   â”‚    â”‚  (å‰¯æœ¬2)   â”‚    â”‚  (å‰¯æœ¬3)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                  â†‘                  â†‘
        â””â”€â”€â”€â”€â”€â”€â”€ æ•°æ®åŒæ­¥ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼šæŸ¥è¯¢æ— éœ€ç½‘ç»œé€šä¿¡ï¼Œå»¶è¿Ÿæœ€ä½
ç¼ºç‚¹ï¼šå†…å­˜ä½¿ç”¨3å€ï¼Œæ•°æ®åŒæ­¥å¼€é”€å¤§

æ¨¡å¼äºŒï¼šåˆ†ç‰‡æ¨¡å¼ï¼ˆå¯æ‰©å±•ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   èŠ‚ç‚¹A     â”‚    â”‚   èŠ‚ç‚¹B     â”‚    â”‚   èŠ‚ç‚¹C     â”‚
â”‚  è¿‡æ»¤å™¨ç‰‡1  â”‚    â”‚  è¿‡æ»¤å™¨ç‰‡2  â”‚    â”‚  è¿‡æ»¤å™¨ç‰‡3  â”‚
â”‚ (èŒƒå›´A-F)  â”‚    â”‚ (èŒƒå›´G-M)  â”‚    â”‚ (èŒƒå›´N-Z)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼šå†…å­˜ä½¿ç”¨ä¼˜åŒ–ï¼Œæ˜“äºæ°´å¹³æ‰©å±•
ç¼ºç‚¹ï¼šæŸ¥è¯¢å¯èƒ½éœ€è¦å¤šæ¬¡ç½‘ç»œé€šä¿¡

åˆ†ç‰‡ç­–ç•¥å®ç°ï¼š
```java
public class DistributedBloomFilter {
    private final List<BloomFilterNode> nodes;
    private final ConsistentHash hashRing;
    private final int replicationFactor;
    
    public DistributedBloomFilter(List<BloomFilterNode> nodes, int replicationFactor) {
        this.nodes = nodes;
        this.replicationFactor = replicationFactor;
        this.hashRing = new ConsistentHash(nodes);
    }
    
    public void add(String item) {
        List<BloomFilterNode> targetNodes = hashRing.getNodes(item, replicationFactor);
        
        // å¹¶è¡Œå†™å…¥å¤šä¸ªå‰¯æœ¬
        CompletableFuture[] futures = targetNodes.stream()
            .map(node -> CompletableFuture.runAsync(() -> node.add(item)))
            .toArray(CompletableFuture[]::new);
            
        CompletableFuture.allOf(futures).join();
    }
    
    public boolean mightContain(String item) {
        List<BloomFilterNode> targetNodes = hashRing.getNodes(item, 1);
        BloomFilterNode primaryNode = targetNodes.get(0);
        
        try {
            return primaryNode.mightContain(item);
        } catch (Exception e) {
            // ä¸»èŠ‚ç‚¹å¤±è´¥ï¼Œå°è¯•å‰¯æœ¬èŠ‚ç‚¹
            for (int i = 1; i < replicationFactor; i++) {
                try {
                    BloomFilterNode replicaNode = hashRing.getNodes(item, i + 1).get(i);
                    return replicaNode.mightContain(item);
                } catch (Exception ex) {
                    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªå‰¯æœ¬
                }
            }
            throw new RuntimeException("All replica nodes failed", e);
        }
    }
}
```

### 8.2 æµ·é‡æ•°æ®å¤„ç†ä¼˜åŒ–


**âš¡ å¤§è§„æ¨¡æ•°æ®å¤„ç†ç­–ç•¥**
```
å¤„ç†ç­–ç•¥åˆ†å±‚ï¼š

ç­–ç•¥ä¸€ï¼šæ‰¹é‡å¤„ç†ä¼˜åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            æ‰¹é‡æ·»åŠ ä¼˜åŒ–                  â”‚
â”‚                                         â”‚
â”‚  å•æ¡æ·»åŠ ï¼šadd(item1), add(item2)...     â”‚
â”‚  æ‰¹é‡æ·»åŠ ï¼šaddBatch([item1,item2...])    â”‚
â”‚                                         â”‚
â”‚  æ€§èƒ½æå‡ï¼š                              â”‚
â”‚  âœ“ å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€                      â”‚
â”‚  âœ“ å‘é‡åŒ–å“ˆå¸Œè®¡ç®—                        â”‚  
â”‚  âœ“ æ‰¹é‡å†…å­˜æ“ä½œ                          â”‚
â”‚  âœ“ å‡å°‘é”ç«äº‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®ç°ç¤ºä¾‹ï¼š
```java
public class BatchOptimizedBloomFilter {
    private final CompactBitArray bitArray;
    private final int hashFunctions;
    private final ReentrantLock lock = new ReentrantLock();
    
    // æ‰¹é‡æ·»åŠ ä¼˜åŒ–
    public void addBatch(List<String> items) {
        if (items.isEmpty()) return;
        
        // é¢„è®¡ç®—æ‰€æœ‰å“ˆå¸Œå€¼
        List<int[]> allHashes = items.parallelStream()
            .map(this::computeHashes)
            .collect(Collectors.toList());
        
        lock.lock();
        try {
            // æ‰¹é‡è®¾ç½®ä½
            for (int[] hashes : allHashes) {
                bitArray.setBits(hashes);
            }
        } finally {
            lock.unlock();
        }
    }
    
    // å‘é‡åŒ–å“ˆå¸Œè®¡ç®—
    private int[] computeHashes(String item) {
        byte[] bytes = item.getBytes(StandardCharsets.UTF_8);
        int[] hashes = new int[hashFunctions];
        
        // ä½¿ç”¨SIMDå‹å¥½çš„å“ˆå¸Œè®¡ç®—
        int hash1 = murmurHash3(bytes, 0);
        int hash2 = murmurHash3(bytes, hash1);
        
        for (int i = 0; i < hashFunctions; i++) {
            hashes[i] = Math.abs((hash1 + i * hash2) % bitArray.size());
        }
        
        return hashes;
    }
    
    // æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–
    public boolean[] mightContainBatch(List<String> items) {
        boolean[] results = new boolean[items.size()];
        
        // å¹¶è¡ŒæŸ¥è¯¢
        IntStream.range(0, items.size()).parallel().forEach(i -> {
            results[i] = mightContain(items.get(i));
        });
        
        return results;
    }
}
```

### 8.3 å®æ—¶æµå¤„ç†é›†æˆ


**ğŸŒŠ æµå¼æ•°æ®å¤„ç†æ¶æ„**
```
æµå¤„ç†æ¶æ„è®¾è®¡ï¼š

æ•°æ®æµå…¥ â†’ è¿‡æ»¤å™¨æ›´æ–° â†’ æŸ¥è¯¢æœåŠ¡
    â†“           â†“           â†“
  Kafka     å®šæœŸé‡å»º     å®æ—¶è¿‡æ»¤
    â†“           â†“           â†“
é¢„å¤„ç†      å¢é‡æ›´æ–°     ç»“æœè¾“å‡º

å®æ—¶æ›´æ–°ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ—¶é—´çª—å£ç®¡ç†                 â”‚
â”‚                                         â”‚
â”‚  çª—å£1(00:00-01:00) â”€â”€â”                â”‚
â”‚                      â”œâ”€â†’ åˆå¹¶è¿‡æ»¤å™¨      â”‚
â”‚  çª—å£2(01:00-02:00) â”€â”€â”˜                â”‚
â”‚                                         â”‚
â”‚  ç‰¹ç‚¹ï¼š                                  â”‚
â”‚  â€¢ æ»‘åŠ¨çª—å£æ›´æ–°                          â”‚
â”‚  â€¢ æ¸è¿›å¼æ•°æ®æ·»åŠ                         â”‚
â”‚  â€¢ å¼‚æ­¥åå°é‡å»º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®ç°ç¤ºä¾‹ï¼š
```java
public class StreamingBloomFilter {
    private volatile BloomFilter activeFilter;
    private volatile BloomFilter shadowFilter;
    private final ScheduledExecutorService scheduler;
    private final BlockingQueue<String> updateQueue;
    
    public StreamingBloomFilter() {
        this.activeFilter = new BloomFilter(1000000, 0.01);
        this.shadowFilter = new BloomFilter(1000000, 0.01);
        this.updateQueue = new LinkedBlockingQueue<>();
        this.scheduler = Executors.newScheduledThreadPool(2);
        
        startBackgroundProcessing();
    }
    
    // å¼‚æ­¥æ·»åŠ æ•°æ®
    public void addAsync(String item) {
        updateQueue.offer(item);
    }
    
    // å®æ—¶æŸ¥è¯¢
    public boolean mightContain(String item) {
        return activeFilter.mightContain(item);
    }
    
    private void startBackgroundProcessing() {
        // æŒç»­å¤„ç†æ›´æ–°é˜Ÿåˆ—
        scheduler.scheduleAtFixedRate(() -> {
            List<String> batch = new ArrayList<>();
            updateQueue.drainTo(batch, 1000);  // æ‰¹é‡å¤„ç†
            
            if (!batch.isEmpty()) {
                // åŒæ—¶æ›´æ–°æ´»è·ƒå’Œå½±å­è¿‡æ»¤å™¨
                for (String item : batch) {
                    activeFilter.add(item);
                    shadowFilter.add(item);
                }
            }
        }, 0, 100, TimeUnit.MILLISECONDS);
        
        // å®šæœŸé‡å»ºè¿‡æ»¤å™¨
        scheduler.scheduleAtFixedRate(() -> {
            rebuildFilter();
        }, 1, 1, TimeUnit.HOURS);
    }
    
    private void rebuildFilter() {
        // åŸºäºæœ€è¿‘æ•°æ®é‡å»ºè¿‡æ»¤å™¨
        BloomFilter newFilter = new BloomFilter(1000000, 0.01);
        
        // ä»æ•°æ®æºé‡æ–°åŠ è½½æ•°æ®
        loadRecentDataIntoFilter(newFilter);
        
        // åŸå­åˆ‡æ¢
        BloomFilter oldActive = activeFilter;
        activeFilter = newFilter;
        shadowFilter = new BloomFilter(1000000, 0.01);
        
        // å¯é€‰ï¼šè®°å½•åˆ‡æ¢æŒ‡æ ‡
        recordFilterSwitch(oldActive, newFilter);
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 æŠ€æœ¯æ¶æ„æ€»è§ˆ


**ğŸ¯ æŠ€æœ¯é€‰å‹å†³ç­–å›¾**
```
æŠ€æœ¯é€‰å‹å†³ç­–æµç¨‹ï¼š

æ•°æ®è§„æ¨¡è¯„ä¼°
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               è§„æ¨¡åˆ†ç±»                   â”‚
â”‚                                         â”‚
â”‚  å°è§„æ¨¡(<1ä¸‡)     â†’ ç®€å•å“ˆå¸Œè¡¨            â”‚
â”‚  ä¸­è§„æ¨¡(1ä¸‡-100ä¸‡) â†’ å•æœºå¸ƒéš†è¿‡æ»¤å™¨        â”‚
â”‚  å¤§è§„æ¨¡(100ä¸‡+)   â†’ åˆ†å¸ƒå¼è¿‡æ»¤å™¨          â”‚
â”‚  è¶…å¤§è§„æ¨¡(äº¿çº§)   â†’ åˆ†å±‚+å‹ç¼©æ¶æ„         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æ€§èƒ½è¦æ±‚è¯„ä¼°
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ€§èƒ½è¦æ±‚åˆ†ç±»                 â”‚
â”‚                                         â”‚
â”‚  ä½å»¶è¿Ÿè¦æ±‚      â†’ å†…å­˜ä¼˜åŒ– + é¢„è®¡ç®—      â”‚
â”‚  é«˜ååè¦æ±‚      â†’ æ‰¹é‡å¤„ç† + å¹¶è¡ŒåŒ–      â”‚
â”‚  å­˜å‚¨æ•æ„Ÿ       â†’ å‹ç¼©ç®—æ³• + åˆ†ç‰‡å­˜å‚¨     â”‚
â”‚  å‡†ç¡®æ€§è¦æ±‚é«˜    â†’ å¤šçº§éªŒè¯ + ä½å‡é˜³æ€§ç‡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æœ€ç»ˆæ¶æ„é€‰æ‹©
```

### 9.2 æ ¸å¿ƒå‚æ•°é…ç½®æŒ‡å—


**âš™ï¸ å‚æ•°é…ç½®é€ŸæŸ¥è¡¨**

| åº”ç”¨åœºæ™¯ | **å…ƒç´ æ•°é‡** | **å†…å­˜é™åˆ¶** | **å‡é˜³æ€§ç‡** | **å“ˆå¸Œå‡½æ•°æ•°** | **ä½æ•°ç»„å¤§å°** |
|---------|-------------|-------------|-------------|---------------|---------------|
| **ç½‘é¡µå»é‡** | `1äº¿` | `500MB` | `5%` | `4` | `512MB` |
| **æ•°æ®åº“è¿‡æ»¤** | `1000ä¸‡` | `100MB` | `1%` | `7` | `96MB` |
| **ç¼“å­˜è¿‡æ»¤** | `100ä¸‡` | `10MB` | `0.1%` | `10` | `14MB` |
| **å®æ—¶æ¨è** | `500ä¸‡` | `50MB` | `2%` | `6` | `48MB` |

**ğŸ”§ è°ƒä¼˜å»ºè®®**
```
å†…å­˜ä¼˜å…ˆåœºæ™¯ï¼š
- å¢å¤§å‡é˜³æ€§ç‡åˆ°å¯æ¥å—èŒƒå›´
- å‡å°‘å“ˆå¸Œå‡½æ•°æ•°é‡
- ä½¿ç”¨å‹ç¼©å­˜å‚¨æŠ€æœ¯

æ€§èƒ½ä¼˜å…ˆåœºæ™¯ï¼š
- ä½¿ç”¨å¿«é€Ÿå“ˆå¸Œå‡½æ•°(MurmurHash3)
- æ‰¹é‡æ“ä½œä¼˜åŒ–
- å¹¶è¡ŒåŒ–æŸ¥è¯¢å¤„ç†

å‡†ç¡®æ€§ä¼˜å…ˆåœºæ™¯ï¼š
- é™ä½å‡é˜³æ€§ç‡(<0.1%)
- å¢åŠ å“ˆå¸Œå‡½æ•°æ•°é‡
- å¤šçº§éªŒè¯æœºåˆ¶
```

### 9.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ­ éƒ¨ç½²å®è·µæŒ‡å—**
```
ç›‘æ§æŒ‡æ ‡è®¾ç½®ï¼š

æ ¸å¿ƒæŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æŒ‡æ ‡ç±»å‹     â”‚    ç›‘æ§é˜ˆå€¼  â”‚   å‘Šè­¦çº§åˆ«   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‡é˜³æ€§ç‡        â”‚ > è®¾è®¡å€¼Ã—1.5 â”‚    è­¦å‘Š     â”‚
â”‚ å†…å­˜ä½¿ç”¨ç‡      â”‚ > 80%       â”‚    è­¦å‘Š     â”‚
â”‚ æŸ¥è¯¢å»¶è¿Ÿ        â”‚ > 50ms      â”‚    ä¸¥é‡     â”‚
â”‚ è¿‡æ»¤å™¨é‡å»ºæ—¶é—´  â”‚ > 30åˆ†é’Ÿ     â”‚    è­¦å‘Š     â”‚
â”‚ æ•°æ®åŒæ­¥å»¶è¿Ÿ    â”‚ > 5åˆ†é’Ÿ      â”‚    ä¸¥é‡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç›‘æ§å®ç°ï¼š
```java
@Component
public class BloomFilterMetrics {
    private final MeterRegistry meterRegistry;
    private final Counter queryCounter;
    private final Counter hitCounter;
    private final Timer queryTimer;
    private final Gauge memoryGauge;
    
    public BloomFilterMetrics(MeterRegistry meterRegistry, BloomFilter filter) {
        this.meterRegistry = meterRegistry;
        this.queryCounter = Counter.builder("bloom.query.total")
            .description("Total queries")
            .register(meterRegistry);
            
        this.hitCounter = Counter.builder("bloom.hit.total")
            .description("Filter hits")
            .register(meterRegistry);
            
        this.queryTimer = Timer.builder("bloom.query.duration")
            .description("Query duration")
            .register(meterRegistry);
            
        this.memoryGauge = Gauge.builder("bloom.memory.usage")
            .description("Memory usage in bytes")
            .register(meterRegistry, filter, f -> f.getMemoryUsage());
    }
    
    public void recordQuery(boolean hit, Duration duration) {
        queryCounter.increment();
        if (hit) {
            hitCounter.increment();
        }
        queryTimer.record(duration);
    }
}
```

**ğŸ”„ è¿ç»´è‡ªåŠ¨åŒ–**
```
è‡ªåŠ¨åŒ–è¿ç»´ç­–ç•¥ï¼š

å®šæœŸä¼˜åŒ–ä»»åŠ¡ï¼š
```bash
#!/bin/bash
# å¸ƒéš†è¿‡æ»¤å™¨ç»´æŠ¤è„šæœ¬

FILTER_NAME="user_filter"
LOG_FILE="/var/log/bloom_maintenance.log"

# æ£€æŸ¥è¿‡æ»¤å™¨çŠ¶æ€
check_filter_health() {
    echo "$(date): Checking filter health..." >> $LOG_FILE
    
    # æ£€æŸ¥å‡é˜³æ€§ç‡
    FPP=$(curl -s "http://localhost:8080/metrics/bloom/fpp/$FILTER_NAME")
    THRESHOLD=0.05
    
    if (( $(echo "$FPP > $THRESHOLD" | bc -l) )); then
        echo "$(date): FPP too high: $FPP, triggering rebuild" >> $LOG_FILE
        rebuild_filter
    fi
    
    # æ£€æŸ¥å†…å­˜ä½¿ç”¨
    MEMORY=$(curl -s "http://localhost:8080/metrics/bloom/memory/$FILTER_NAME")
    MAX_MEMORY=1073741824  # 1GB
    
    if [ "$MEMORY" -gt "$MAX_MEMORY" ]; then
        echo "$(date): Memory usage too high: $MEMORY bytes" >> $LOG_FILE
        optimize_memory
    fi
}

# é‡å»ºè¿‡æ»¤å™¨
rebuild_filter() {
    echo "$(date): Starting filter rebuild..." >> $LOG_FILE
    
    # åˆ›å»ºæ–°è¿‡æ»¤å™¨
    curl -X POST "http://localhost:8080/bloom/$FILTER_NAME/rebuild" \
        -H "Content-Type: application/json" \
        -d '{"optimize": true}'
    
    if [ $? -eq 0 ]; then
        echo "$(date): Filter rebuild completed successfully" >> $LOG_FILE
    else
        echo "$(date): Filter rebuild failed" >> $LOG_FILE
        # å‘é€å‘Šè­¦
        send_alert "Bloom filter rebuild failed for $FILTER_NAME"
    fi
}

# å†…å­˜ä¼˜åŒ–
optimize_memory() {
    echo "$(date): Starting memory optimization..." >> $LOG_FILE
    
    curl -X POST "http://localhost:8080/bloom/$FILTER_NAME/optimize" \
        -H "Content-Type: application/json"
}

# å‘é€å‘Šè­¦
send_alert() {
    local message="$1"
    # å‘é€åˆ°å‘Šè­¦ç³»ç»Ÿ (ä¾‹å¦‚: PagerDuty, Slackç­‰)
    curl -X POST "https://hooks.slack.com/webhook-url" \
        -d "{\"text\": \"$message\"}"
}

# ä¸»æ‰§è¡Œæµç¨‹
main() {
    check_filter_health
}

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
main
```

### 9.4 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**
```
é—®é¢˜è¯Šæ–­å†³ç­–æ ‘ï¼š

æŸ¥è¯¢æ€§èƒ½ä¸‹é™
    â†“
æ£€æŸ¥å‡é˜³æ€§ç‡æ˜¯å¦è¿‡é«˜ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ é‡å»ºè¿‡æ»¤å™¨æˆ–è°ƒæ•´å‚æ•°
    â””â”€ å¦ â†“
æ£€æŸ¥å†…å­˜ä½¿ç”¨æ˜¯å¦è¿‡é«˜ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ å¯ç”¨å‹ç¼©æˆ–å¢åŠ å†…å­˜
    â””â”€ å¦ â†“
æ£€æŸ¥å“ˆå¸Œå‡½æ•°æ˜¯å¦æœ‰çƒ­ç‚¹ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ æ›´æ¢å“ˆå¸Œå‡½æ•°æˆ–å¢åŠ å‡½æ•°æ•°é‡
    â””â”€ å¦ â†’ æ£€æŸ¥åº•å±‚å­˜å‚¨æ€§èƒ½

å†…å­˜ä½¿ç”¨å¼‚å¸¸
    â†“
æ£€æŸ¥ä½æ•°ç»„å¡«å……ç‡ï¼Ÿ
    â”œâ”€ >50% â†’ è¿‡æ»¤å™¨è¿‡è½½ï¼Œéœ€è¦æ‰©å®¹
    â””â”€ <50% â†“
æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ æ£€æŸ¥å†…å­˜æ± ç®¡ç†ä»£ç 
    â””â”€ å¦ â†’ æ£€æŸ¥å‹ç¼©ç®—æ³•æ•ˆæœ

å‡é˜³æ€§ç‡å¼‚å¸¸é«˜
    â†“
æ£€æŸ¥æ•°æ®åˆ†å¸ƒæ˜¯å¦å‡åŒ€ï¼Ÿ
    â”œâ”€ å¦ â†’ è°ƒæ•´å“ˆå¸Œå‡½æ•°æˆ–æ•°æ®é¢„å¤„ç†
    â””â”€ æ˜¯ â†“
æ£€æŸ¥è¿‡æ»¤å™¨æ˜¯å¦è¿‡è½½ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ å¢å¤§ä½æ•°ç»„æˆ–åˆ†ç‰‡å¤„ç†
    â””â”€ å¦ â†’ æ£€æŸ¥å“ˆå¸Œå‡½æ•°è´¨é‡

è¯Šæ–­å·¥å…·è„šæœ¬ï¼š
```java
public class BloomFilterDiagnostics {
    
    public DiagnosticReport diagnose(BloomFilter filter) {
        DiagnosticReport report = new DiagnosticReport();
        
        // 1. åŸºç¡€æŒ‡æ ‡æ£€æŸ¥
        report.memoryUsage = filter.getMemoryUsage();
        report.elementCount = filter.getElementCount();
        report.fillRatio = filter.getFillRatio();
        
        // 2. æ€§èƒ½æŒ‡æ ‡åˆ†æ
        report.averageQueryTime = measureAverageQueryTime(filter);
        report.actualFPP = measureActualFPP(filter);
        
        // 3. å¥åº·çŠ¶æ€è¯„ä¼°
        report.healthScore = calculateHealthScore(report);
        report.recommendations = generateRecommendations(report);
        
        return report;
    }
    
    private double measureActualFPP(BloomFilter filter) {
        // ä½¿ç”¨å·²çŸ¥ä¸å­˜åœ¨çš„æ•°æ®æµ‹è¯•å‡é˜³æ€§ç‡
        List<String> testData = generateNonExistentData(10000);
        int falsePositives = 0;
        
        for (String item : testData) {
            if (filter.mightContain(item)) {
                falsePositives++;
            }
        }
        
        return (double) falsePositives / testData.size();
    }
    
    private List<String> generateRecommendations(DiagnosticReport report) {
        List<String> recommendations = new ArrayList<>();
        
        if (report.fillRatio > 0.5) {
            recommendations.add("ä½æ•°ç»„å¡«å……ç‡è¿‡é«˜ï¼Œå»ºè®®æ‰©å®¹æˆ–é‡å»ºè¿‡æ»¤å™¨");
        }
        
        if (report.actualFPP > report.theoreticalFPP * 1.5) {
            recommendations.add("å®é™…å‡é˜³æ€§ç‡è¿‡é«˜ï¼Œæ£€æŸ¥å“ˆå¸Œå‡½æ•°è´¨é‡æˆ–æ•°æ®åˆ†å¸ƒ");
        }
        
        if (report.averageQueryTime > Duration.ofMillis(10)) {
            recommendations.add("æŸ¥è¯¢å»¶è¿Ÿè¿‡é«˜ï¼Œè€ƒè™‘æ€§èƒ½ä¼˜åŒ–");
        }
        
        return recommendations;
    }
}
```

### 9.5 æŠ€æœ¯æ¼”è¿›è¶‹åŠ¿


**ğŸš€ å‰æ²¿æŠ€æœ¯æ–¹å‘**
```
æŠ€æœ¯å‘å±•è¶‹åŠ¿ï¼š

ç¡¬ä»¶åŠ é€Ÿï¼š
â”œâ”€ GPUåŠ é€Ÿå“ˆå¸Œè®¡ç®—
â”œâ”€ FPGAä¸“ç”¨åŠ é€Ÿå™¨
â”œâ”€ æ–°å‹å†…å­˜æŠ€æœ¯(Intel Optane)
â””â”€ é‡å­å“ˆå¸Œç®—æ³•ç ”ç©¶

ç®—æ³•ä¼˜åŒ–ï¼š
â”œâ”€ æœºå™¨å­¦ä¹ ä¼˜åŒ–å‚æ•°é€‰æ‹©
â”œâ”€ è‡ªé€‚åº”å‡é˜³æ€§ç‡æ§åˆ¶
â”œâ”€ å¤šç»´åº¦å¸ƒéš†è¿‡æ»¤å™¨
â””â”€ æ¦‚ç‡æ•°æ®ç»“æ„èåˆ

åº”ç”¨æ‰©å±•ï¼š
â”œâ”€ åŒºå—é“¾è½»èŠ‚ç‚¹éªŒè¯
â”œâ”€ IoTè®¾å¤‡èµ„æºä¼˜åŒ–
â”œâ”€ è¾¹ç¼˜è®¡ç®—æ•°æ®è¿‡æ»¤
â””â”€ éšç§ä¿æŠ¤è®¡ç®—

å·¥ç¨‹å®è·µï¼š
â”œâ”€ äº‘åŸç”Ÿéƒ¨ç½²æ¨¡å¼
â”œâ”€ æœåŠ¡ç½‘æ ¼é›†æˆ
â”œâ”€ å¯è§‚æµ‹æ€§å¢å¼º
â””â”€ è‡ªåŠ¨åŒ–è¿ç»´å®Œå–„
```

**ğŸ’¡ å­¦ä¹ èµ„æºæ¨è**
```
ç†è®ºåŸºç¡€ï¼š
ğŸ“š ã€ŠProbabilistic Data Structures and Algorithmsã€‹
ğŸ“š ã€ŠMining of Massive Datasetsã€‹
ğŸ“š ã€ŠIntroduction to Information Retrievalã€‹

å¼€æºé¡¹ç›®ï¼š
ğŸ”§ Google Guava BloomFilter
ğŸ”§ Redis Bloom Module  
ğŸ”§ Apache Spark BloomFilter
ğŸ”§ RoaringBitmap

å®è·µæ¡ˆä¾‹ï¼š
ğŸ¢ Google BigTableå¸ƒéš†è¿‡æ»¤å™¨åº”ç”¨
ğŸ¢ Cassandraè¯»è·¯å¾„ä¼˜åŒ–
ğŸ¢ HBase StoreFileå¸ƒéš†è¿‡æ»¤å™¨
ğŸ¢ Elasticsearchå€’æ’ç´¢å¼•ä¼˜åŒ–
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å€’æ’ç´¢å¼•è¯å…¸å»ºï¼Œå¿«é€Ÿæ£€ç´¢æ–‡æ¡£å…¨
- å¸ƒéš†è¿‡æ»¤è¯¯åˆ¤æœ‰ï¼Œç¡®å®šæ— è¯¯æ°¸ä¸æ„  
- å‚æ•°è°ƒä¼˜éœ€å¹³è¡¡ï¼Œå†…å­˜æ€§èƒ½ä¸¤ç›¸å®œ
- å¤§æ•°æ®åœºæ™¯åˆ†å¸ƒå¼ï¼Œç›‘æ§è¿ç»´è¦è·Ÿä¸Š
- å‡é˜³æ€§æ§åˆ¶æ˜¯å…³é”®ï¼Œå¤šçº§éªŒè¯ä¿å‡†ç¡®