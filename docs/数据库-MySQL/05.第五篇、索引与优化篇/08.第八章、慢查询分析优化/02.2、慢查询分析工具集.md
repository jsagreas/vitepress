---
title: 2ã€æ…¢æŸ¥è¯¢åˆ†æå·¥å…·é›†
---
## ğŸ“š ç›®å½•

1. [æ…¢æŸ¥è¯¢åˆ†æå·¥å…·æ¦‚è¿°](#1-æ…¢æŸ¥è¯¢åˆ†æå·¥å…·æ¦‚è¿°)
2. [mysqldumpslowå·¥å…·æ·±å…¥ä½¿ç”¨](#2-mysqldumpslowå·¥å…·æ·±å…¥ä½¿ç”¨)
3. [pt-query-digeståˆ†æè¯¦è§£](#3-pt-query-digeståˆ†æè¯¦è§£)
4. [percona-toolkitåº”ç”¨å®æˆ˜](#4-percona-toolkitåº”ç”¨å®æˆ˜)
5. [Performance Schemaç›‘æ§ä½“ç³»](#5-performance-schemaç›‘æ§ä½“ç³»)
6. [æ…¢æŸ¥è¯¢åˆ†æå¹³å°æ¶æ„](#6-æ…¢æŸ¥è¯¢åˆ†æå¹³å°æ¶æ„)
7. [å¤šç»´åº¦åˆ†æè§†å›¾](#7-å¤šç»´åº¦åˆ†æè§†å›¾)
8. [å®æ—¶æ…¢æŸ¥è¯¢ç›‘æ§](#8-å®æ—¶æ…¢æŸ¥è¯¢ç›‘æ§)
9. [æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹æ ‡å‡†åŒ–](#9-æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹æ ‡å‡†åŒ–)
10. [åˆ†æå·¥å…·é›†æˆæ–¹æ¡ˆ](#10-åˆ†æå·¥å…·é›†æˆæ–¹æ¡ˆ)
11. [å·¥å…·æ€§èƒ½å¯¹æ¯”è¯„ä¼°](#11-å·¥å…·æ€§èƒ½å¯¹æ¯”è¯„ä¼°)
12. [è‡ªåŠ¨åŒ–åˆ†ææµç¨‹](#12-è‡ªåŠ¨åŒ–åˆ†ææµç¨‹)
13. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#13-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æ…¢æŸ¥è¯¢åˆ†æå·¥å…·æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢åˆ†æå·¥å…·


**é€šä¿—ç†è§£**ï¼šæ…¢æŸ¥è¯¢åˆ†æå·¥å…·å°±åƒæ˜¯"æ•°æ®åº“çš„ä½“æ£€åŒ»ç”Ÿ"ï¼Œå®ƒä»¬ä¸“é—¨ç”¨æ¥æ£€æŸ¥å’Œåˆ†ææ•°æ®åº“ä¸­è¿è¡Œç¼“æ…¢çš„SQLè¯­å¥ï¼Œå¸®æˆ‘ä»¬æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
ä½“æ£€åŒ»ç”Ÿå·¥ä½œæµç¨‹ï¼š           æ…¢æŸ¥è¯¢åˆ†æå·¥å…·ï¼š
æ”¶é›†ä½“æ£€æ•°æ®     â†’        æ”¶é›†æ…¢æŸ¥è¯¢æ—¥å¿—
åˆ†æå¼‚å¸¸æŒ‡æ ‡     â†’        åˆ†æSQLæ‰§è¡Œæ€§èƒ½
è¯Šæ–­æ½œåœ¨é—®é¢˜     â†’        è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
åˆ¶å®šæ²»ç–—æ–¹æ¡ˆ     â†’        æä¾›ä¼˜åŒ–å»ºè®®
```

**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
- **æ—¥å¿—è§£æ**ï¼šè¯»å–å’Œè§£æMySQLæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶
- **ç»Ÿè®¡åˆ†æ**ï¼šå¯¹æ…¢æŸ¥è¯¢è¿›è¡Œåˆ†ç±»å’Œç»Ÿè®¡åˆ†æ
- **æŠ¥å‘Šç”Ÿæˆ**ï¼šç”Ÿæˆå¯è¯»æ€§å¼ºçš„åˆ†ææŠ¥å‘Š
- **ä¼˜åŒ–å»ºè®®**ï¼šæä¾›é’ˆå¯¹æ€§çš„ä¼˜åŒ–å»ºè®®

### 1.2 æ…¢æŸ¥è¯¢åˆ†æå·¥å…·åˆ†ç±»


**ğŸ“Š å·¥å…·åˆ†ç±»è¡¨**

| å·¥å…·ç±»å‹ | ä»£è¡¨å·¥å…· | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|----------|------|----------|
| **åŸç”Ÿå·¥å…·** | mysqldumpslow | MySQLå®˜æ–¹å·¥å…·ï¼Œç®€å•æ˜“ç”¨ | åŸºç¡€åˆ†æéœ€æ±‚ |
| **ç¬¬ä¸‰æ–¹å·¥å…·** | pt-query-digest | åŠŸèƒ½å¼ºå¤§ï¼ŒæŠ¥å‘Šè¯¦ç»† | æ·±åº¦åˆ†æéœ€æ±‚ |
| **å›¾å½¢åŒ–å·¥å…·** | PMMã€Anemometer | å¯è§†åŒ–ç•Œé¢ï¼Œå®æ—¶ç›‘æ§ | è¿ç»´ç®¡ç†éœ€æ±‚ |
| **è‡ªå®šä¹‰è„šæœ¬** | Python/Shellè„šæœ¬ | å®šåˆ¶åŒ–å¼ºï¼Œçµæ´»æ€§é«˜ | ç‰¹æ®Šä¸šåŠ¡éœ€æ±‚ |

**ğŸ’¡ é€‰æ‹©åŸåˆ™**
```
åŸºç¡€ä½¿ç”¨ï¼šmysqldumpslowè¶³å¤Ÿ
æ·±åº¦åˆ†æï¼špt-query-digestæ›´å¥½
å®æ—¶ç›‘æ§ï¼šå›¾å½¢åŒ–å·¥å…·æ›´ç›´è§‚
å®šåˆ¶éœ€æ±‚ï¼šè‡ªå®šä¹‰è„šæœ¬æ›´çµæ´»
```

---

## 2. ğŸ› ï¸ mysqldumpslowå·¥å…·æ·±å…¥ä½¿ç”¨


### 2.1 mysqldumpslowåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ å·¥å…·ç®€ä»‹**
mysqldumpslowæ˜¯MySQLå®˜æ–¹æä¾›çš„æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼Œç”¨Perlè¯­è¨€ç¼–å†™ï¼ŒéšMySQLä¸€èµ·å®‰è£…ã€‚

**ğŸ“ å·¥å…·ä½ç½®**
```bash
# é€šå¸¸åœ¨MySQLå®‰è£…ç›®å½•çš„binæ–‡ä»¶å¤¹ä¸‹
/usr/local/mysql/bin/mysqldumpslow
/usr/bin/mysqldumpslow
```

### 2.2 mysqldumpslowå‚æ•°è¯¦è§£


**ğŸ¯ æ ¸å¿ƒå‚æ•°è¯´æ˜**

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|------|
| **-s** | æ’åºæ–¹å¼ | `-s c` | cæŒ‰æ¬¡æ•°ï¼ŒtæŒ‰æ—¶é—´ï¼ŒlæŒ‰é”å®šæ—¶é—´ |
| **-r** | å€’åºæ’åˆ— | `-r` | ä¸-sé…åˆä½¿ç”¨ |
| **-t** | æ˜¾ç¤ºæ¡æ•° | `-t 10` | åªæ˜¾ç¤ºå‰10æ¡ |
| **-a** | ä¸æŠ½è±¡åŒ–æ•°å­— | `-a` | æ˜¾ç¤ºå…·ä½“æ•°å€¼è€ŒéN |
| **-g** | æ­£åˆ™åŒ¹é… | `-g 'select'` | åªæ˜¾ç¤ºåŒ…å«selectçš„æŸ¥è¯¢ |

**ğŸ“Š æ’åºé€‰é¡¹è¯¦è§£**
```bash
-s c    # æŒ‰æŸ¥è¯¢æ¬¡æ•°æ’åºï¼ˆCountï¼‰
-s t    # æŒ‰å¹³å‡æŸ¥è¯¢æ—¶é—´æ’åºï¼ˆTimeï¼‰  
-s l    # æŒ‰å¹³å‡é”å®šæ—¶é—´æ’åºï¼ˆLockï¼‰
-s r    # æŒ‰è¿”å›è®°å½•æ•°æ’åºï¼ˆRowsï¼‰
-s ac   # æŒ‰å¹³å‡æŸ¥è¯¢æ¬¡æ•°æ’åº
-s at   # æŒ‰æ€»æŸ¥è¯¢æ—¶é—´æ’åº
```

### 2.3 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹


**ğŸš€ åŸºæœ¬ä½¿ç”¨æ–¹æ³•**
```bash
# 1. æŸ¥çœ‹æœ€æ…¢çš„10æ¡æŸ¥è¯¢
mysqldumpslow -s t -t 10 /var/log/mysql/mysql-slow.log

# 2. æŸ¥çœ‹è®¿é—®æ¬¡æ•°æœ€å¤šçš„10æ¡æŸ¥è¯¢
mysqldumpslow -s c -t 10 /var/log/mysql/mysql-slow.log

# 3. æŸ¥çœ‹è¿”å›è®°å½•æ•°æœ€å¤šçš„10æ¡æŸ¥è¯¢
mysqldumpslow -s r -t 10 /var/log/mysql/mysql-slow.log

# 4. æŒ‰é”å®šæ—¶é—´æ’åº
mysqldumpslow -s l -t 10 /var/log/mysql/mysql-slow.log
```

**ğŸ’¡ å®é™…åˆ†æç¤ºä¾‹**
```bash
# åˆ†æåŒ…å«ç‰¹å®šè¡¨çš„æ…¢æŸ¥è¯¢
mysqldumpslow -g 'users' /var/log/mysql/mysql-slow.log

# æ˜¾ç¤ºå…·ä½“æ•°å€¼ï¼Œä¸è¿›è¡ŒæŠ½è±¡åŒ–
mysqldumpslow -a -s t -t 5 /var/log/mysql/mysql-slow.log

# ç»„åˆä½¿ç”¨ï¼šæŒ‰æ€»æ—¶é—´æ’åºï¼Œæ˜¾ç¤ºå‰20æ¡ï¼ŒåŒ…å«SELECTè¯­å¥
mysqldumpslow -s at -t 20 -g 'SELECT' /var/log/mysql/mysql-slow.log
```

### 2.4 æŠ¥å‘Šè¾“å‡ºè§£è¯»


**ğŸ“‹ è¾“å‡ºæ ¼å¼è¯´æ˜**
```bash
Count: 152  Time=0.34s (52s)  Lock=0.00s (0s)  Rows=1.0 (152), root[root]@localhost
  SELECT * FROM users WHERE status = 'S' ORDER BY create_time DESC LIMIT N
```

**ğŸ” å­—æ®µå«ä¹‰è§£é‡Š**
```
Count: 152          # è¯¥ç±»æŸ¥è¯¢å‡ºç°152æ¬¡
Time=0.34s (52s)    # å¹³å‡æ‰§è¡Œæ—¶é—´0.34ç§’ï¼Œæ€»è®¡52ç§’
Lock=0.00s (0s)     # å¹³å‡é”å®šæ—¶é—´0ç§’ï¼Œæ€»è®¡0ç§’  
Rows=1.0 (152)      # å¹³å‡è¿”å›1è¡Œï¼Œæ€»è®¡è¿”å›152è¡Œ
root[root]@localhost # æ‰§è¡Œç”¨æˆ·å’Œæ¥æº
```

### 2.5 é«˜çº§ä½¿ç”¨æŠ€å·§


**ğŸ”¥ æ‰¹é‡æ—¥å¿—å¤„ç†**
```bash
# å¤„ç†å¤šä¸ªæ—¥å¿—æ–‡ä»¶
mysqldumpslow -s t -t 10 /var/log/mysql/mysql-slow.log*

# å¤„ç†å‹ç¼©æ—¥å¿—æ–‡ä»¶
zcat /var/log/mysql/mysql-slow.log.*.gz | mysqldumpslow -s t -t 10

# å®æ—¶ç›‘æ§æ…¢æŸ¥è¯¢ï¼ˆé…åˆtailä½¿ç”¨ï¼‰
tail -f /var/log/mysql/mysql-slow.log | mysqldumpslow -s t
```

**ğŸ“Š è¾“å‡ºé‡å®šå‘å’Œæ ¼å¼åŒ–**
```bash
# å°†åˆ†æç»“æœä¿å­˜åˆ°æ–‡ä»¶
mysqldumpslow -s t -t 20 /var/log/mysql/mysql-slow.log > slow_analysis.txt

# ç”ŸæˆHTMLæŠ¥å‘Šï¼ˆéœ€è¦è‡ªå®šä¹‰è„šæœ¬ï¼‰
mysqldumpslow -s t -t 50 /var/log/mysql/mysql-slow.log | \
    python format_slow_log.py > slow_report.html
```

---

## 3. ğŸ¯ pt-query-digeståˆ†æè¯¦è§£


### 3.1 pt-query-digestå·¥å…·ä»‹ç»


**ğŸ”¸ å·¥å…·ç‰¹ç‚¹**
pt-query-digestæ˜¯Percona Toolkitä¸­æœ€å¼ºå¤§çš„æ…¢æŸ¥è¯¢åˆ†æå·¥å…·ï¼Œæä¾›æ¯”mysqldumpslowæ›´è¯¦ç»†å’Œä¸“ä¸šçš„åˆ†ææŠ¥å‘Šã€‚

**ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿**
- **æŸ¥è¯¢æŒ‡çº¹**ï¼šè‡ªåŠ¨è¯†åˆ«ç›¸ä¼¼æŸ¥è¯¢æ¨¡å¼
- **è¯¦ç»†ç»Ÿè®¡**ï¼šæä¾›å…¨æ–¹ä½çš„æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯
- **å¤šæ•°æ®æº**ï¼šæ”¯æŒæ—¥å¿—æ–‡ä»¶ã€processlistã€tcpdumpç­‰
- **æ ¼å¼ä¸°å¯Œ**ï¼šæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼

### 3.2 å®‰è£…å’ŒåŸºç¡€ä½¿ç”¨


**ğŸ“¦ å®‰è£…æ–¹å¼**
```bash
# CentOS/RHEL
yum install percona-toolkit

# Ubuntu/Debian  
apt-get install percona-toolkit

# éªŒè¯å®‰è£…
pt-query-digest --version
```

**ğŸš€ åŸºç¡€ä½¿ç”¨ç¤ºä¾‹**
```bash
# åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—
pt-query-digest /var/log/mysql/mysql-slow.log

# åˆ†ææœ€è¿‘1å°æ—¶çš„æ…¢æŸ¥è¯¢
pt-query-digest --since '1h ago' /var/log/mysql/mysql-slow.log

# åªåˆ†æSELECTè¯­å¥
pt-query-digest --filter '$event->{fingerprint} =~ m/^select/' /var/log/mysql/mysql-slow.log
```

### 3.3 æŸ¥è¯¢æŒ‡çº¹ç”ŸæˆæŠ€æœ¯


**ğŸ”¸ ä»€ä¹ˆæ˜¯æŸ¥è¯¢æŒ‡çº¹**
æŸ¥è¯¢æŒ‡çº¹æ˜¯å°†ç›¸ä¼¼çš„SQLè¯­å¥æŠ½è±¡åŒ–åå¾—åˆ°çš„æ ‡å‡†æ¨¡å¼ï¼Œç”¨äºè¯†åˆ«åŒä¸€ç±»æŸ¥è¯¢ã€‚

**ğŸ’¡ æŒ‡çº¹ç”Ÿæˆç¤ºä¾‹**
```sql
-- åŸå§‹æŸ¥è¯¢1
SELECT * FROM users WHERE id = 123 AND status = 'active';

-- åŸå§‹æŸ¥è¯¢2  
SELECT * FROM users WHERE id = 456 AND status = 'active';

-- ç”Ÿæˆçš„æŸ¥è¯¢æŒ‡çº¹
SELECT * FROM users WHERE id = ? AND status = ?;
```

**ğŸ¯ æŒ‡çº¹çš„ä½œç”¨**
```
ç›¸åŒæŒ‡çº¹çš„æŸ¥è¯¢ä¼šè¢«å½’ç±»åˆ°ä¸€èµ·è¿›è¡Œç»Ÿè®¡åˆ†æï¼š
â€¢ æ‰§è¡Œæ¬¡æ•°æ±‡æ€»
â€¢ æ‰§è¡Œæ—¶é—´ç»Ÿè®¡ï¼ˆæœ€å°å€¼ã€æœ€å¤§å€¼ã€å¹³å‡å€¼ï¼‰
â€¢ èµ„æºæ¶ˆè€—åˆ†æ
â€¢ ä¼˜åŒ–å»ºè®®ç”Ÿæˆ
```

### 3.4 è¯¦ç»†åˆ†ææŠ¥å‘Šè§£è¯»


**ğŸ“Š æŠ¥å‘Šç»“æ„è¯´æ˜**
```
pt-query-digestæŠ¥å‘ŠåŒ…å«ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š
1. æ•´ä½“ç»Ÿè®¡ä¿¡æ¯ï¼ˆOverallï¼‰
2. æŸ¥è¯¢æ’è¡Œæ¦œï¼ˆTop queriesï¼‰  
3. è¯¦ç»†æŸ¥è¯¢åˆ†æï¼ˆQuery detailsï¼‰
```

**ğŸ” æ•´ä½“ç»Ÿè®¡ä¿¡æ¯ç¤ºä¾‹**
```
# Overall: 1.5k total, 25 unique, 0.15 QPS, 0.05x concurrency
# Time range: 2024-01-01 00:00:00 to 2024-01-02 00:00:00
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           300s     1ms   15.2s   200ms   1.2s    800ms    50ms
# Lock time            12s     0us   100ms     8ms    20ms     5ms     5ms
# Rows sent          15.2k       0   2.5k      10      25      50       8
# Rows examine       1.2M        0   15.6k     800   2.1k     1.5k     250
```

### 3.5 é«˜çº§åˆ†æåŠŸèƒ½


**ğŸ”¥ å¤šç»´åº¦è¿‡æ»¤åˆ†æ**
```bash
# æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤
pt-query-digest --since '2024-01-01' --until '2024-01-02' slow.log

# æŒ‰æ‰§è¡Œæ—¶é—´è¿‡æ»¤ï¼ˆåªåˆ†ææ‰§è¡Œæ—¶é—´>1ç§’çš„æŸ¥è¯¢ï¼‰
pt-query-digest --filter '$event->{Query_time} > 1' slow.log

# æŒ‰ç”¨æˆ·è¿‡æ»¤
pt-query-digest --filter '$event->{user} eq "app_user"' slow.log

# æŒ‰æ•°æ®åº“è¿‡æ»¤
pt-query-digest --filter '$event->{db} eq "ecommerce"' slow.log
```

**ğŸ“ˆ è¾“å‡ºæ ¼å¼å®šåˆ¶**
```bash
# ç”ŸæˆJSONæ ¼å¼æŠ¥å‘Š
pt-query-digest --output json slow.log > slow_report.json

# ç”Ÿæˆç®€æ´æŠ¥å‘Š
pt-query-digest --output profile slow.log

# è‡ªå®šä¹‰æŠ¥å‘Šå†…å®¹
pt-query-digest --report-format query_report,profile slow.log
```

---

## 4. ğŸ§° percona-toolkitåº”ç”¨å®æˆ˜


### 4.1 percona-toolkitå·¥å…·é›†æ¦‚è¿°


**ğŸ”¸ å·¥å…·é›†ä»‹ç»**
Percona Toolkitæ˜¯ä¸€å¥—ç”¨äºMySQLå’ŒMongoDBç®¡ç†çš„å¼€æºå·¥å…·é›†åˆï¼ŒåŒ…å«30å¤šä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚

**ğŸ“Š æ…¢æŸ¥è¯¢ç›¸å…³æ ¸å¿ƒå·¥å…·**

| å·¥å…·å | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| **pt-query-digest** | æ…¢æŸ¥è¯¢åˆ†æ | æ—¥å¿—åˆ†æå’Œæ€§èƒ½ä¼˜åŒ– |
| **pt-mysql-summary** | ç³»ç»ŸçŠ¶æ€æ€»è§ˆ | æ•´ä½“æ€§èƒ½è¯„ä¼° |
| **pt-index-usage** | ç´¢å¼•ä½¿ç”¨åˆ†æ | ç´¢å¼•ä¼˜åŒ– |
| **pt-duplicate-key-checker** | é‡å¤ç´¢å¼•æ£€æŸ¥ | ç´¢å¼•æ¸…ç† |

### 4.2 pt-mysql-summaryç³»ç»Ÿåˆ†æ


**ğŸ¯ ç³»ç»Ÿæ•´ä½“æ€§èƒ½è¯„ä¼°**
```bash
# ç”ŸæˆMySQLç³»ç»ŸçŠ¶æ€æŠ¥å‘Š
pt-mysql-summary --user=root --password=password --host=localhost

# å°†æŠ¥å‘Šä¿å­˜åˆ°æ–‡ä»¶
pt-mysql-summary --user=root --password=password > mysql_summary.txt
```

**ğŸ“‹ æŠ¥å‘Šå†…å®¹è§£è¯»**
```
æŠ¥å‘ŠåŒ…å«ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š
â€¢ MySQLç‰ˆæœ¬å’Œé…ç½®ä¿¡æ¯
â€¢ ç³»ç»Ÿç¡¬ä»¶èµ„æºä½¿ç”¨æƒ…å†µ
â€¢ æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢ç»Ÿè®¡
â€¢ å­˜å‚¨å¼•æ“ä½¿ç”¨æƒ…å†µ
â€¢ å…³é”®æ€§èƒ½æŒ‡æ ‡åˆ†æ
```

### 4.3 pt-index-usageç´¢å¼•åˆ†æ


**ğŸ” ç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æ**
```bash
# åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
pt-index-usage --user=root --password=password \
    --host=localhost database_name

# ä»æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­åˆ†æç´¢å¼•ä½¿ç”¨
pt-index-usage --user=root --password=password \
    --source-of-queries /var/log/mysql/mysql-slow.log
```

### 4.4 ç»¼åˆåˆ†æå·¥ä½œæµ


**ğŸ”¥ å®Œæ•´åˆ†ææµç¨‹**
```bash
#!/bin/bash
# æ…¢æŸ¥è¯¢ç»¼åˆåˆ†æè„šæœ¬

LOG_FILE="/var/log/mysql/mysql-slow.log"
REPORT_DIR="/opt/mysql-reports"
DATE=$(date +%Y%m%d)

# 1. åŸºç¡€æ…¢æŸ¥è¯¢åˆ†æ
echo "å¼€å§‹æ…¢æŸ¥è¯¢åˆ†æ..."
pt-query-digest $LOG_FILE > $REPORT_DIR/slow-query-$DATE.txt

# 2. ç³»ç»ŸçŠ¶æ€åˆ†æ  
echo "ç”Ÿæˆç³»ç»ŸçŠ¶æ€æŠ¥å‘Š..."
pt-mysql-summary --user=root --password=password > $REPORT_DIR/system-summary-$DATE.txt

# 3. ç´¢å¼•ä½¿ç”¨åˆ†æ
echo "åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ..."
pt-index-usage --user=root --password=password \
    --source-of-queries $LOG_FILE > $REPORT_DIR/index-usage-$DATE.txt

echo "åˆ†æå®Œæˆï¼ŒæŠ¥å‘Šä¿å­˜åœ¨ $REPORT_DIR"
```

---

## 5. ğŸ“Š Performance Schemaç›‘æ§ä½“ç³»


### 5.1 Performance SchemaåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯Performance Schema**
Performance Schemaæ˜¯MySQL 5.5+ç‰ˆæœ¬æä¾›çš„æ€§èƒ½ç›‘æ§åŠŸèƒ½ï¼Œé€šè¿‡å†…å­˜ä¸­çš„è¡¨æ¥æ”¶é›†å’Œå­˜å‚¨æ€§èƒ½æ•°æ®ã€‚

```
ä¼ ç»Ÿç›‘æ§æ–¹å¼ï¼š                Performance Schemaï¼š
æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—     â†’        å®æ—¶æ€§èƒ½æ•°æ®æ”¶é›†
æ‰‹å·¥åˆ†ææ—¥å¿—       â†’        æ ‡å‡†SQLæŸ¥è¯¢åˆ†æ  
é™æ€å†å²æ•°æ®       â†’        åŠ¨æ€å®æ—¶ç›‘æ§
```

**ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿**
- **å®æ—¶æ€§**ï¼šæä¾›å®æ—¶çš„æ€§èƒ½ç›‘æ§æ•°æ®
- **æ ‡å‡†åŒ–**ï¼šä½¿ç”¨æ ‡å‡†SQLè¿›è¡ŒæŸ¥è¯¢åˆ†æ
- **ç»†ç²’åº¦**ï¼šæä¾›è¯­å¥çº§ã€äº‹ä»¶çº§çš„è¯¦ç»†ä¿¡æ¯
- **ä½å¼€é”€**ï¼šå¯¹æ•°æ®åº“æ€§èƒ½å½±å“æœ€å°

### 5.2 å…³é”®ç›‘æ§è¡¨è¯´æ˜


**ğŸ“‹ æ ¸å¿ƒç›‘æ§è¡¨åˆ†ç±»**

| è¡¨ç±»åˆ« | ä»£è¡¨è¡¨å | ç›‘æ§å†…å®¹ |
|--------|----------|----------|
| **è¯­å¥ç»Ÿè®¡** | `events_statements_*` | SQLè¯­å¥æ‰§è¡Œç»Ÿè®¡ |
| **ç­‰å¾…äº‹ä»¶** | `events_waits_*` | é”ç­‰å¾…ã€IOç­‰å¾… |
| **ç´¢å¼•ä½¿ç”¨** | `table_io_waits_*` | è¡¨å’Œç´¢å¼•è®¿é—®ç»Ÿè®¡ |
| **è¿æ¥ä¿¡æ¯** | `processlist` | å½“å‰è¿æ¥çŠ¶æ€ |

### 5.3 å¸¸ç”¨ç›‘æ§æŸ¥è¯¢


**ğŸ¯ æ…¢æŸ¥è¯¢å®æ—¶ç›‘æ§**
```sql
-- æŸ¥çœ‹å½“å‰æ‰§è¡Œæ—¶é—´æœ€é•¿çš„æŸ¥è¯¢
SELECT 
    thread_id,
    event_id,
    truncate(timer_wait/1000000000000,6) as exec_time_s,
    sql_text
FROM performance_schema.events_statements_current 
WHERE timer_wait > 1000000000000  -- æ‰§è¡Œæ—¶é—´>1ç§’
ORDER BY timer_wait DESC;
```

**ğŸ“Š æŸ¥è¯¢ç»Ÿè®¡åˆ†æ**
```sql
-- æŸ¥çœ‹æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„æŸ¥è¯¢
SELECT 
    count_star as exec_count,
    truncate(avg_timer_wait/1000000000000,6) as avg_time_s,
    truncate(max_timer_wait/1000000000000,6) as max_time_s,
    digest_text
FROM performance_schema.events_statements_summary_by_digest
ORDER BY count_star DESC
LIMIT 10;
```

### 5.4 ç´¢å¼•ä½¿ç”¨ç›‘æ§é…ç½®


**ğŸ”§ å¼€å¯ç´¢å¼•ç»Ÿè®¡**
```sql
-- å¼€å¯è¡¨IOç»Ÿè®¡
UPDATE performance_schema.setup_consumers 
SET ENABLED = 'YES' 
WHERE NAME = 'events_waits_summary_by_instance';

-- å¼€å¯è¡¨é”ç»Ÿè®¡
UPDATE performance_schema.setup_consumers 
SET ENABLED = 'YES' 
WHERE NAME = 'events_waits_summary_by_thread_by_event_name';
```

**ğŸ“ˆ ç´¢å¼•ä½¿ç”¨åˆ†ææŸ¥è¯¢**
```sql
-- æŸ¥çœ‹è¡¨çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT 
    object_schema,
    object_name,
    index_name,
    count_read,
    count_write,
    count_fetch,
    count_insert,
    count_update,
    count_delete
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'your_database'
ORDER BY count_read DESC;
```

### 5.5 ç›‘æ§æ•°æ®æ”¶é›†ç­–ç•¥


**âš¡ ç›‘æ§é…ç½®ä¼˜åŒ–**
```sql
-- é…ç½®ç›‘æ§ç²’åº¦
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME LIKE 'statement/%';

-- è®¾ç½®å†å²è®°å½•å¤§å°
SET GLOBAL performance_schema_events_statements_history_size = 20;
SET GLOBAL performance_schema_events_statements_history_long_size = 1000;
```

---

## 6. ğŸ—ï¸ æ…¢æŸ¥è¯¢åˆ†æå¹³å°æ¶æ„


### 6.1 åˆ†æå¹³å°æ•´ä½“æ¶æ„


**ğŸ”¸ å¹³å°æ¶æ„è®¾è®¡**
```
æ•°æ®é‡‡é›†å±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ…¢æŸ¥è¯¢æ—¥å¿—   â”‚ Performance â”‚ ä¸šåŠ¡ç›‘æ§æ•°æ® â”‚
â”‚ æ–‡ä»¶æ”¶é›†     â”‚ Schemaæ•°æ®  â”‚ æ¥å£é‡‡é›†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
æ•°æ®å¤„ç†å±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¥å¿—è§£æ â†’ æ•°æ®æ¸…æ´— â†’ æŒ‡çº¹ç”Ÿæˆ â†’ ç»Ÿè®¡åˆ†æ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
æ•°æ®å­˜å‚¨å±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸå§‹æ—¥å¿—     â”‚ åˆ†æç»“æœ     â”‚ å†å²è¶‹åŠ¿     â”‚
â”‚ å­˜å‚¨åº“       â”‚ æ•°æ®åº“       â”‚ æ•°æ®ä»“åº“     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
åº”ç”¨æœåŠ¡å±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ†æAPI     â”‚ æŠ¥å‘Šç”Ÿæˆ     â”‚ å‘Šè­¦æœåŠ¡     â”‚
â”‚ æ¥å£æœåŠ¡     â”‚ æœåŠ¡         â”‚ æ¨¡å—         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
å±•ç¤ºå±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Webç®¡ç†ç•Œé¢ â”‚ ç§»åŠ¨ç«¯APP   â”‚ APIæ¥å£     â”‚
â”‚ Dashboard   â”‚ ç›‘æ§åº”ç”¨     â”‚ ç¬¬ä¸‰æ–¹é›†æˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å¹³å°æ ¸å¿ƒåŠŸèƒ½æ¨¡å—


**ğŸ“Š åŠŸèƒ½æ¨¡å—åˆ’åˆ†**

| æ¨¡å—åç§° | æ ¸å¿ƒåŠŸèƒ½ | æŠ€æœ¯å®ç° |
|----------|----------|----------|
| **æ•°æ®é‡‡é›†** | æ—¥å¿—æ”¶é›†ã€å®æ—¶ç›‘æ§ | Filebeat, Fluentd |
| **æ•°æ®å¤„ç†** | è§£æã€æ¸…æ´—ã€åˆ†æ | Python, Spark |
| **å­˜å‚¨ç®¡ç†** | æ•°æ®å­˜å‚¨ã€ç´¢å¼•ä¼˜åŒ– | MySQL, ClickHouse |
| **åˆ†æå¼•æ“** | ç®—æ³•åˆ†æã€è¶‹åŠ¿é¢„æµ‹ | pandas, scikit-learn |
| **å¯è§†åŒ–** | å›¾è¡¨å±•ç¤ºã€äº¤äº’ç•Œé¢ | React, ECharts |
| **å‘Šè­¦ç³»ç»Ÿ** | è§„åˆ™é…ç½®ã€é€šçŸ¥å‘é€ | Prometheus, Alert Manager |

### 6.3 æ…¢æŸ¥è¯¢åˆ†æAPIæ¥å£


**ğŸ”¥ æ ¸å¿ƒAPIè®¾è®¡**
```python
# APIæ¥å£è®¾è®¡ç¤ºä¾‹
class SlowQueryAPI:
    def get_slow_queries(self, 
                        start_time=None, 
                        end_time=None, 
                        database=None, 
                        limit=100):
        """è·å–æ…¢æŸ¥è¯¢åˆ—è¡¨"""
        pass
    
    def get_query_statistics(self, 
                           query_fingerprint):
        """è·å–æŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯"""  
        pass
    
    def get_optimization_suggestions(self, 
                                   query_fingerprint):
        """è·å–ä¼˜åŒ–å»ºè®®"""
        pass
```

**ğŸ“‹ APIå“åº”æ ¼å¼**
```json
{
  "status": "success",
  "data": {
    "total": 150,
    "queries": [
      {
        "fingerprint": "select * from users where id = ?",
        "count": 45,
        "avg_time": 0.85,
        "max_time": 2.34,
        "first_seen": "2024-01-01 10:00:00",
        "last_seen": "2024-01-01 18:30:00"
      }
    ]
  }
}
```

---

## 7. ğŸ“ˆ å¤šç»´åº¦åˆ†æè§†å›¾


### 7.1 æ—¶é—´ç»´åº¦åˆ†æ


**ğŸ“… æ—¶é—´è¶‹åŠ¿åˆ†æ**
```sql
-- æŒ‰å°æ—¶ç»Ÿè®¡æ…¢æŸ¥è¯¢è¶‹åŠ¿
SELECT 
    DATE_FORMAT(ts, '%Y-%m-%d %H:00:00') as hour_time,
    COUNT(*) as slow_query_count,
    AVG(query_time) as avg_query_time,
    MAX(query_time) as max_query_time
FROM slow_query_log 
WHERE ts >= DATE_SUB(NOW(), INTERVAL 24 HOUR)
GROUP BY DATE_FORMAT(ts, '%Y-%m-%d %H:00:00')
ORDER BY hour_time;
```

**ğŸ¯ å³°å€¼æ—¶æ®µè¯†åˆ«**
```sql
-- è¯†åˆ«æ…¢æŸ¥è¯¢é«˜å³°æ—¶æ®µ
SELECT 
    HOUR(ts) as hour_of_day,
    COUNT(*) as query_count,
    AVG(query_time) as avg_time
FROM slow_query_log 
WHERE ts >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY HOUR(ts)
ORDER BY query_count DESC;
```

### 7.2 ä¸šåŠ¡ç»´åº¦åˆ†æ


**ğŸ“Š æŒ‰æ•°æ®åº“åˆ†æ**
```sql
-- æŒ‰æ•°æ®åº“ç»Ÿè®¡æ…¢æŸ¥è¯¢åˆ†å¸ƒ
SELECT 
    db as database_name,
    COUNT(*) as slow_query_count,
    AVG(query_time) as avg_query_time,
    SUM(query_time) as total_query_time,
    COUNT(DISTINCT query_fingerprint) as unique_queries
FROM slow_query_log 
GROUP BY db
ORDER BY slow_query_count DESC;
```

**ğŸ¯ æŒ‰ç”¨æˆ·åˆ†æ**
```sql  
-- æŒ‰ç”¨æˆ·ç»Ÿè®¡æ…¢æŸ¥è¯¢æƒ…å†µ
SELECT 
    user as username,
    host,
    COUNT(*) as slow_query_count,
    AVG(query_time) as avg_query_time,
    MAX(query_time) as max_query_time
FROM slow_query_log 
GROUP BY user, host
ORDER BY slow_query_count DESC;
```

### 7.3 æ€§èƒ½ç»´åº¦åˆ†æ


**âš¡ æ‰§è¡Œæ—¶é—´åˆ†å¸ƒåˆ†æ**
```sql
-- æ…¢æŸ¥è¯¢æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ
SELECT 
    CASE 
        WHEN query_time < 1 THEN '< 1ç§’'
        WHEN query_time < 5 THEN '1-5ç§’'
        WHEN query_time < 10 THEN '5-10ç§’'
        WHEN query_time < 30 THEN '10-30ç§’'
        ELSE '> 30ç§’'
    END as time_range,
    COUNT(*) as query_count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM slow_query_log), 2) as percentage
FROM slow_query_log
GROUP BY time_range
ORDER BY query_count DESC;
```

---

## 8. â±ï¸ å®æ—¶æ…¢æŸ¥è¯¢ç›‘æ§


### 8.1 å®æ—¶ç›‘æ§ç³»ç»Ÿè®¾è®¡


**ğŸ”¸ ç›‘æ§ç³»ç»Ÿæ¶æ„**
```
å®æ—¶æ•°æ®æµï¼š
MySQL Performance Schema
         â†“
ç›‘æ§æ•°æ®é‡‡é›†å™¨ (æ¯5ç§’é‡‡é›†)
         â†“  
å®æ—¶æ•°æ®å¤„ç† (æµå¤„ç†å¼•æ“)
         â†“
å‘Šè­¦è§„åˆ™å¼•æ“ (é˜ˆå€¼æ£€æŸ¥)
         â†“
é€šçŸ¥ç³»ç»Ÿ (é‚®ä»¶/çŸ­ä¿¡/é’‰é’‰)
         â†“
å®æ—¶Dashboard (WebSocketæ¨é€)
```

### 8.2 å®æ—¶ç›‘æ§æŸ¥è¯¢


**âš¡ å½“å‰æ‰§è¡Œä¸­çš„æ…¢æŸ¥è¯¢**
```sql
-- ç›‘æ§å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ…¢æŸ¥è¯¢
SELECT 
    p.ID,
    p.USER,
    p.HOST,
    p.DB,
    p.TIME as running_seconds,
    LEFT(p.INFO, 100) as query_text,
    IF(p.TIME > 10, 'ä¸¥é‡', IF(p.TIME > 5, 'è­¦å‘Š', 'æ­£å¸¸')) as alert_level
FROM information_schema.PROCESSLIST p
WHERE p.COMMAND = 'Query' 
  AND p.TIME > 3  -- æ‰§è¡Œæ—¶é—´>3ç§’
  AND p.INFO IS NOT NULL
ORDER BY p.TIME DESC;
```

**ğŸ“Š å®æ—¶æ€§èƒ½æŒ‡æ ‡ç›‘æ§**
```sql
-- å®æ—¶æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡
SELECT 
    'Current Slow Queries' as metric_name,
    COUNT(*) as current_value,
    NOW() as timestamp
FROM information_schema.PROCESSLIST 
WHERE COMMAND = 'Query' AND TIME > 2

UNION ALL

SELECT 
    'Avg Query Time (Last 5min)' as metric_name,
    ROUND(AVG(TIMER_WAIT/1000000000000), 3) as current_value,
    NOW() as timestamp
FROM performance_schema.events_statements_history_long
WHERE TIMER_START > UNIX_TIMESTAMP(DATE_SUB(NOW(), INTERVAL 5 MINUTE)) * 1000000000000;
```

### 8.3 å‘Šè­¦è§„åˆ™é…ç½®


**ğŸš¨ å‘Šè­¦è§„åˆ™å®šä¹‰**
```yaml
# æ…¢æŸ¥è¯¢å‘Šè­¦è§„åˆ™é…ç½®
alert_rules:
  - name: "æ…¢æŸ¥è¯¢æ•°é‡å‘Šè­¦"
    condition: "current_slow_queries > 10"
    severity: "warning"
    duration: "2m"
    message: "å½“å‰æ…¢æŸ¥è¯¢æ•°é‡å¼‚å¸¸: {{value}}æ¡"
    
  - name: "å•ä¸ªæŸ¥è¯¢æ‰§è¡Œæ—¶é—´å‘Šè­¦"  
    condition: "max_query_time > 30"
    severity: "critical"
    duration: "0s"
    message: "å‘ç°è¶…é•¿æŸ¥è¯¢ï¼Œæ‰§è¡Œæ—¶é—´: {{value}}ç§’"
    
  - name: "æ…¢æŸ¥è¯¢å¢é•¿ç‡å‘Šè­¦"
    condition: "slow_query_growth_rate > 50"
    severity: "warning" 
    duration: "5m"
    message: "æ…¢æŸ¥è¯¢æ•°é‡å¢é•¿å¼‚å¸¸: {{value}}%"
```

---

## 9. ğŸ“‹ æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹æ ‡å‡†åŒ–


### 9.1 æ…¢æŸ¥è¯¢å‘ç°æµç¨‹


**ğŸ” å‘ç°æµç¨‹æ ‡å‡†åŒ–**
```
æ­¥éª¤1: æ…¢æŸ¥è¯¢æ£€æµ‹
â”œâ”€ ç›‘æ§å‘Šè­¦è§¦å‘
â”œâ”€ å®šæœŸæ—¥å¿—åˆ†æ  
â””â”€ æ€§èƒ½æŒ‡æ ‡å¼‚å¸¸

æ­¥éª¤2: é—®é¢˜è¯„ä¼°
â”œâ”€ å½±å“èŒƒå›´è¯„ä¼°
â”œâ”€ ä¸šåŠ¡å½±å“ç¨‹åº¦
â””â”€ ä¼˜åŒ–ç´§æ€¥ç¨‹åº¦

æ­¥éª¤3: é—®é¢˜åˆ†ç±»
â”œâ”€ SQLè¯­å¥é—®é¢˜
â”œâ”€ ç´¢å¼•è®¾è®¡é—®é¢˜
â”œâ”€ æ•°æ®åº“é…ç½®é—®é¢˜
â””â”€ ç¡¬ä»¶èµ„æºé—®é¢˜
```

### 9.2 é—®é¢˜è¯Šæ–­æ ‡å‡†åŒ–


**ğŸ¯ è¯Šæ–­æ£€æŸ¥æ¸…å•**
```sql
-- 1. æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’åˆ†æ
EXPLAIN FORMAT=JSON 
SELECT * FROM users WHERE status = 'active' ORDER BY create_time DESC;

-- 2. ç´¢å¼•ä½¿ç”¨æƒ…å†µæ£€æŸ¥
SHOW INDEX FROM users;

-- 3. è¡¨ç»Ÿè®¡ä¿¡æ¯æ£€æŸ¥
SHOW TABLE STATUS LIKE 'users';

-- 4. ç³»ç»Ÿèµ„æºä½¿ç”¨æ£€æŸ¥
SHOW GLOBAL STATUS LIKE '%slow%';
SHOW GLOBAL VARIABLES LIKE '%slow%';
```

**ğŸ“Š è¯Šæ–­æŠ¥å‘Šæ¨¡æ¿**
```
æ…¢æŸ¥è¯¢è¯Šæ–­æŠ¥å‘Š
===============
æŸ¥è¯¢æŒ‡çº¹: SELECT * FROM users WHERE status = ? ORDER BY create_time DESC
æ‰§è¡Œæ¬¡æ•°: 156æ¬¡/å°æ—¶
å¹³å‡æ‰§è¡Œæ—¶é—´: 2.3ç§’
æœ€å¤§æ‰§è¡Œæ—¶é—´: 8.7ç§’

é—®é¢˜åˆ†æ:
1. ç¼ºå°‘å¤åˆç´¢å¼• (status, create_time)
2. æ’åºå­—æ®µæœªå»ºç´¢å¼•
3. è¿”å›å­—æ®µè¿‡å¤šï¼Œå»ºè®®ä½¿ç”¨å…·ä½“å­—æ®µ

ä¼˜åŒ–å»ºè®®:
1. åˆ›å»ºå¤åˆç´¢å¼•: CREATE INDEX idx_status_time ON users(status, create_time)
2. ä¼˜åŒ–æŸ¥è¯¢è¯­å¥: SELECT id,name,email FROM users WHERE...
3. è€ƒè™‘åˆ†é¡µæŸ¥è¯¢ï¼Œé¿å…ä¸€æ¬¡è¿”å›å¤§é‡æ•°æ®

é¢„æœŸæ•ˆæœ:
æ‰§è¡Œæ—¶é—´é¢„è®¡é™ä½è‡³0.1ç§’ä»¥å†…
```

### 9.3 ä¼˜åŒ–æ–¹æ¡ˆåˆ¶å®šæµç¨‹


**ğŸ”§ ä¼˜åŒ–æ–¹æ¡ˆæ ‡å‡†æµç¨‹**

| æ­¥éª¤ | å†…å®¹ | è¾“å‡º |
|------|------|------|
| **åˆ†æ** | EXPLAINåˆ†æã€ç´¢å¼•æ£€æŸ¥ | é—®é¢˜åŸå› æŠ¥å‘Š |
| **è®¾è®¡** | åˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆã€è¯„ä¼°é£é™© | ä¼˜åŒ–æ–¹æ¡ˆæ–‡æ¡£ |
| **æµ‹è¯•** | å¼€å‘ç¯å¢ƒéªŒè¯ã€æ€§èƒ½æµ‹è¯• | æµ‹è¯•ç»“æœæŠ¥å‘Š |
| **å®æ–½** | ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œã€ç›‘æ§è§‚å¯Ÿ | å®æ–½è®°å½• |
| **éªŒè¯** | æ•ˆæœè¯„ä¼°ã€æŒç»­ç›‘æ§ | æ•ˆæœè¯„ä¼°æŠ¥å‘Š |

### 9.4 æ•ˆæœéªŒè¯æœºåˆ¶


**ğŸ“ˆ éªŒè¯æŒ‡æ ‡å®šä¹‰**
```sql
-- ä¼˜åŒ–å‰åæ•ˆæœå¯¹æ¯”æŸ¥è¯¢
SELECT 
    'ä¼˜åŒ–å‰' as period,
    COUNT(*) as execution_count,
    AVG(query_time) as avg_time,
    MAX(query_time) as max_time
FROM slow_query_log_archive 
WHERE query_fingerprint = 'SELECT * FROM users WHERE status = ?'
  AND ts BETWEEN '2024-01-01' AND '2024-01-02'

UNION ALL

SELECT 
    'ä¼˜åŒ–å' as period,
    COUNT(*) as execution_count, 
    AVG(query_time) as avg_time,
    MAX(query_time) as max_time
FROM slow_query_log
WHERE query_fingerprint = 'SELECT * FROM users WHERE status = ?'
  AND ts BETWEEN '2024-01-03' AND '2024-01-04';
```

---

## 10. ğŸ”— åˆ†æå·¥å…·é›†æˆæ–¹æ¡ˆ


### 10.1 å·¥å…·é“¾æ•´åˆæ¶æ„


**ğŸ—ï¸ é›†æˆæ¶æ„è®¾è®¡**
```
å·¥å…·æ•´åˆå±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç›‘æ§æ•°æ®ç»Ÿä¸€æ¥å…¥å±‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MySQLæ—¥å¿—   â”‚ Performance â”‚ åº”ç”¨ç›‘æ§     â”‚ 
â”‚ æ¥å…¥        â”‚ Schemaæ¥å…¥  â”‚ æ•°æ®æ¥å…¥     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ•°æ®å¤„ç†å’Œåˆ†æå±‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mysqldumpslowâ”‚ pt-query-   â”‚ è‡ªå®šä¹‰       â”‚
â”‚ å¤„ç†æ¨¡å—     â”‚ digestæ¨¡å—  â”‚ åˆ†ææ¨¡å—     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç»“æœæ•´åˆå’Œè¾“å‡ºå±‚               â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç»Ÿä¸€æŠ¥å‘Š     â”‚ APIæ¥å£     â”‚ å¯è§†åŒ–       â”‚
â”‚ ç”Ÿæˆ        â”‚ æœåŠ¡        â”‚ Dashboard    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 æ™ºèƒ½æ¨èç³»ç»Ÿ


**ğŸ§  åˆ†æå·¥å…·æ™ºèƒ½æ¨è**
```python
class ToolRecommendationEngine:
    def recommend_tool(self, analysis_requirements):
        """æ ¹æ®åˆ†æéœ€æ±‚æ¨èåˆé€‚çš„å·¥å…·"""
        if analysis_requirements.get('real_time'):
            return ['Performance Schema', 'è‡ªå®šä¹‰ç›‘æ§è„šæœ¬']
        elif analysis_requirements.get('detail_level') == 'high':
            return ['pt-query-digest', 'pt-mysql-summary']
        elif analysis_requirements.get('simplicity') == 'high':
            return ['mysqldumpslow']
        else:
            return ['pt-query-digest', 'mysqldumpslow']
    
    def get_tool_combination(self, use_case):
        """æ¨èå·¥å…·ç»„åˆæ–¹æ¡ˆ"""
        combinations = {
            'daily_analysis': ['mysqldumpslow', 'pt-query-digest'],
            'emergency_debug': ['Performance Schema', 'è‡ªå®šä¹‰è„šæœ¬'],
            'comprehensive_audit': ['pt-query-digest', 'pt-mysql-summary', 'pt-index-usage'],
            'production_monitoring': ['Performance Schema', 'PMM', 'å‘Šè­¦ç³»ç»Ÿ']
        }
        return combinations.get(use_case, ['pt-query-digest'])
```

### 10.3 è‡ªåŠ¨åŒ–å¤„ç†å¹³å°


**ğŸ¤– å¤„ç†æµç¨‹è‡ªåŠ¨åŒ–**
```bash
#!/bin/bash
# è‡ªåŠ¨åŒ–æ…¢æŸ¥è¯¢åˆ†æå¤„ç†æµç¨‹

# é…ç½®æ–‡ä»¶
CONFIG_FILE="/etc/slow-query-analysis/config.conf"
source $CONFIG_FILE

# 1. æ•°æ®é‡‡é›†
collect_slow_logs() {
    echo "å¼€å§‹é‡‡é›†æ…¢æŸ¥è¯¢æ—¥å¿—..."
    rsync -av $MYSQL_SLOW_LOG_PATH $ANALYSIS_WORK_DIR/
}

# 2. å¤šå·¥å…·å¹¶è¡Œåˆ†æ
parallel_analysis() {
    echo "å¼€å§‹å¹¶è¡Œåˆ†æ..."
    
    # mysqldumpslow åˆ†æ
    mysqldumpslow -s t -t 20 $SLOW_LOG_FILE > $OUTPUT_DIR/mysqldumpslow_report.txt &
    
    # pt-query-digest åˆ†æ  
    pt-query-digest $SLOW_LOG_FILE > $OUTPUT_DIR/pt_query_digest_report.txt &
    
    # è‡ªå®šä¹‰è„šæœ¬åˆ†æ
    python3 /opt/scripts/custom_analysis.py $SLOW_LOG_FILE > $OUTPUT_DIR/custom_report.txt &
    
    wait  # ç­‰å¾…æ‰€æœ‰åå°ä»»åŠ¡å®Œæˆ
}

# 3. ç»“æœæ•´åˆ
merge_results() {
    echo "æ•´åˆåˆ†æç»“æœ..."
    python3 /opt/scripts/merge_reports.py \
        --mysqldumpslow $OUTPUT_DIR/mysqldumpslow_report.txt \
        --pt-query-digest $OUTPUT_DIR/pt_query_digest_report.txt \
        --custom $OUTPUT_DIR/custom_report.txt \
        --output $OUTPUT_DIR/merged_report.html
}

# 4. å‘é€æŠ¥å‘Š
send_report() {
    echo "å‘é€åˆ†ææŠ¥å‘Š..."
    mail -s "æ…¢æŸ¥è¯¢åˆ†ææŠ¥å‘Š $(date)" \
         -a $OUTPUT_DIR/merged_report.html \
         $RECIPIENT_EMAIL < /dev/null
}

# ä¸»æµç¨‹æ‰§è¡Œ
main() {
    collect_slow_logs
    parallel_analysis  
    merge_results
    send_report
    echo "è‡ªåŠ¨åŒ–åˆ†ææµç¨‹å®Œæˆ"
}

main "$@"
```

---

## 11. âš–ï¸ å·¥å…·æ€§èƒ½å¯¹æ¯”è¯„ä¼°


### 11.1 å·¥å…·æ•ˆæœè¯„ä¼°ä½“ç³»


**ğŸ“Š è¯„ä¼°ç»´åº¦å®šä¹‰**

| è¯„ä¼°ç»´åº¦ | æƒé‡ | è¯„ä¼°æŒ‡æ ‡ |
|----------|------|----------|
| **åˆ†æå‡†ç¡®æ€§** | 30% | é—®é¢˜è¯†åˆ«ç‡ã€è¯¯æŠ¥ç‡ã€æ¼æŠ¥ç‡ |
| **åˆ†ææ•ˆç‡** | 25% | å¤„ç†é€Ÿåº¦ã€èµ„æºæ¶ˆè€—ã€å¹¶å‘èƒ½åŠ› |
| **åŠŸèƒ½å®Œæ•´æ€§** | 20% | åŠŸèƒ½è¦†ç›–åº¦ã€å®šåˆ¶èƒ½åŠ›ã€æ‰©å±•æ€§ |
| **æ˜“ç”¨æ€§** | 15% | å­¦ä¹ æˆæœ¬ã€æ“ä½œå¤æ‚åº¦ã€æ–‡æ¡£è´¨é‡ |
| **ç¨³å®šæ€§** | 10% | é”™è¯¯ç‡ã€å…¼å®¹æ€§ã€å¯é æ€§ |

### 11.2 å·¥å…·å¯¹æ¯”æµ‹è¯•


**âš¡ æ€§èƒ½æµ‹è¯•å¯¹æ¯”**
```bash
# æµ‹è¯•è„šæœ¬ï¼šå¯¹æ¯”ä¸åŒå·¥å…·çš„å¤„ç†æ€§èƒ½
#!/bin/bash

LOG_FILE="sample_slow_query.log"  # 100MBæµ‹è¯•æ—¥å¿—æ–‡ä»¶
ITERATIONS=5

echo "å¼€å§‹å·¥å…·æ€§èƒ½å¯¹æ¯”æµ‹è¯•..."

# æµ‹è¯• mysqldumpslow
echo "æµ‹è¯• mysqldumpslow..."
total_time=0
for i in $(seq 1 $ITERATIONS); do
    start_time=$(date +%s.%N)
    mysqldumpslow -s t -t 50 $LOG_FILE > /dev/null
    end_time=$(date +%s.%N)
    time_diff=$(echo "$end_time - $start_time" | bc)
    total_time=$(echo "$total_time + $time_diff" | bc)
done
avg_time=$(echo "scale=2; $total_time / $ITERATIONS" | bc)
echo "mysqldumpslow å¹³å‡å¤„ç†æ—¶é—´: ${avg_time}ç§’"

# æµ‹è¯• pt-query-digest  
echo "æµ‹è¯• pt-query-digest..."
total_time=0
for i in $(seq 1 $ITERATIONS); do
    start_time=$(date +%s.%N)
    pt-query-digest $LOG_FILE > /dev/null
    end_time=$(date +%s.%N)
    time_diff=$(echo "$end_time - $start_time" | bc)
    total_time=$(echo "$total_time + $time_diff" | bc)
done
avg_time=$(echo "scale=2; $total_time / $ITERATIONS" | bc)
echo "pt-query-digest å¹³å‡å¤„ç†æ—¶é—´: ${avg_time}ç§’"
```

### 11.3 å·¥å…·é€‰æ‹©å†³ç­–çŸ©é˜µ


**ğŸ¯ å†³ç­–çŸ©é˜µ**

| åœºæ™¯ | æ¨èå·¥å…· | ç†ç”± |
|------|----------|------|
| **æ—¥å¸¸å·¡æ£€** | mysqldumpslow | é€Ÿåº¦å¿«ï¼Œæ»¡è¶³åŸºæœ¬éœ€æ±‚ |
| **æ·±åº¦åˆ†æ** | pt-query-digest | åˆ†æè¯¦ç»†ï¼ŒæŠ¥å‘Šä¸“ä¸š |
| **å®æ—¶ç›‘æ§** | Performance Schema | å®æ—¶æ€§å¥½ï¼Œå¼€é”€å° |
| **ç”Ÿäº§ç¯å¢ƒç›‘æ§** | PMM/Grafana | å¯è§†åŒ–å¥½ï¼Œå‘Šè­¦å®Œå–„ |
| **æ‰¹é‡åˆ†æ** | è‡ªå®šä¹‰è„šæœ¬ | çµæ´»æ€§é«˜ï¼Œå¯å®šåˆ¶ |

---

## 12. ğŸ¤– è‡ªåŠ¨åŒ–åˆ†ææµç¨‹


### 12.1 åˆ†ææµç¨‹è‡ªåŠ¨åŒ–è®¾è®¡


**ğŸ”„ å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹**
```
è§¦å‘æ¡ä»¶:
â”œâ”€ å®šæ—¶è§¦å‘ (æ¯æ—¥ã€æ¯å‘¨)
â”œâ”€ é˜ˆå€¼è§¦å‘ (æ…¢æŸ¥è¯¢æ•°é‡å¼‚å¸¸)
â”œâ”€ æ‰‹åŠ¨è§¦å‘ (æŒ‰éœ€åˆ†æ)
â””â”€ äº‹ä»¶è§¦å‘ (æ€§èƒ½å‘Šè­¦)

æ‰§è¡Œæµç¨‹:
æ•°æ®é‡‡é›† â†’ é¢„å¤„ç† â†’ å¤šå·¥å…·åˆ†æ â†’ ç»“æœæ•´åˆ â†’ æŠ¥å‘Šç”Ÿæˆ â†’ é€šçŸ¥å‘é€

åç»­å¤„ç†:
â”œâ”€ å†å²æ•°æ®å­˜æ¡£
â”œâ”€ è¶‹åŠ¿åˆ†ææ›´æ–°
â”œâ”€ åŸºçº¿æ•°æ®æ›´æ–°
â””â”€ ä¼˜åŒ–å»ºè®®è·Ÿè¸ª
```

### 12.2 æ™ºèƒ½åŒ–åˆ†æç®—æ³•


**ğŸ§  æœºå™¨å­¦ä¹ è¾…åŠ©åˆ†æ**
```python
class IntelligentSlowQueryAnalyzer:
    def __init__(self):
        self.pattern_recognizer = PatternRecognizer()
        self.anomaly_detector = AnomalyDetector()
        self.recommendation_engine = RecommendationEngine()
    
    def analyze_query_patterns(self, queries):
        """è¯†åˆ«æŸ¥è¯¢æ¨¡å¼å’Œå¼‚å¸¸"""
        patterns = self.pattern_recognizer.extract_patterns(queries)
        anomalies = self.anomaly_detector.detect_anomalies(queries)
        return patterns, anomalies
    
    def generate_smart_recommendations(self, query_analysis):
        """ç”Ÿæˆæ™ºèƒ½ä¼˜åŒ–å»ºè®®"""
        recommendations = []
        
        # åŸºäºå†å²æ•°æ®çš„æ¨è
        historical_recommendations = self.recommendation_engine.get_historical_recommendations(
            query_analysis.fingerprint
        )
        
        # åŸºäºç›¸ä¼¼æŸ¥è¯¢çš„æ¨è
        similar_query_recommendations = self.recommendation_engine.get_similar_query_recommendations(
            query_analysis
        )
        
        return recommendations
```

### 12.3 æŠ¥å‘Šç”Ÿæˆè‡ªåŠ¨åŒ–


**ğŸ“„ è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆ**
```python
class AutoReportGenerator:
    def generate_comprehensive_report(self, analysis_data):
        """ç”Ÿæˆç»¼åˆåˆ†ææŠ¥å‘Š"""
        report = {
            'summary': self._generate_summary(analysis_data),
            'top_issues': self._identify_top_issues(analysis_data),
            'trends': self._analyze_trends(analysis_data),
            'recommendations': self._generate_recommendations(analysis_data),
            'action_items': self._create_action_items(analysis_data)
        }
        
        # ç”Ÿæˆå¤šç§æ ¼å¼çš„æŠ¥å‘Š
        self._generate_html_report(report)
        self._generate_pdf_report(report)
        self._generate_json_report(report)
        
        return report
```

---

## 13. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 13.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ…¢æŸ¥è¯¢åˆ†æå·¥å…·æœ¬è´¨ï¼šä¸“é—¨ç”¨äºåˆ†æMySQLæ…¢æŸ¥è¯¢æ—¥å¿—çš„ä¸“ä¸šå·¥å…·
ğŸ”¸ mysqldumpslowï¼šMySQLå®˜æ–¹å·¥å…·ï¼Œç®€å•æ˜“ç”¨ï¼Œé€‚åˆåŸºç¡€åˆ†æ
ğŸ”¸ pt-query-digestï¼šåŠŸèƒ½å¼ºå¤§çš„ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œé€‚åˆæ·±åº¦åˆ†æ
ğŸ”¸ Performance Schemaï¼šMySQLå†…ç½®ç›‘æ§ï¼Œæä¾›å®æ—¶æ€§èƒ½æ•°æ®
ğŸ”¸ å·¥å…·é€‰æ‹©åŸåˆ™ï¼šæ ¹æ®åˆ†æéœ€æ±‚å’ŒæŠ€æœ¯æ°´å¹³é€‰æ‹©åˆé€‚å·¥å…·
```

### 13.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å·¥å…·ç‰¹ç‚¹å¯¹æ¯”**
```
mysqldumpslowç‰¹ç‚¹ï¼š
â€¢ å®˜æ–¹å·¥å…·ï¼Œå…¼å®¹æ€§å¥½
â€¢ ä½¿ç”¨ç®€å•ï¼Œå­¦ä¹ æˆæœ¬ä½
â€¢ åˆ†æé€Ÿåº¦å¿«ï¼Œå ç”¨èµ„æºå°‘
â€¢ åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼ŒæŠ¥å‘Šä¿¡æ¯æœ‰é™

pt-query-digestç‰¹ç‚¹ï¼š
â€¢ åˆ†æåŠŸèƒ½å¼ºå¤§ï¼ŒæŠ¥å‘Šè¯¦ç»†
â€¢ æ”¯æŒå¤šç§æ•°æ®æºå’Œè¾“å‡ºæ ¼å¼
â€¢ æŸ¥è¯¢æŒ‡çº¹æŠ€æœ¯ï¼Œå½’ç±»ç²¾å‡†
â€¢ å­¦ä¹ æˆæœ¬è¾ƒé«˜ï¼ŒåŠŸèƒ½å¤æ‚

Performance Schemaç‰¹ç‚¹ï¼š
â€¢ å®æ—¶ç›‘æ§ï¼Œæ•°æ®å‡†ç¡®
â€¢ æ ‡å‡†SQLæŸ¥è¯¢ï¼Œä½¿ç”¨çµæ´»
â€¢ å†…ç½®åŠŸèƒ½ï¼Œæ— éœ€å®‰è£…
â€¢ éœ€è¦ä¸€å®šçš„SQLåŸºç¡€
```

**ğŸ”¹ åˆ†æå¹³å°æ¶æ„è®¾è®¡**
```
è®¾è®¡åŸåˆ™ï¼š
â€¢ æ•°æ®é‡‡é›†å±‚ï¼šæ”¯æŒå¤šæ•°æ®æºæ¥å…¥
â€¢ å¤„ç†åˆ†æå±‚ï¼šé›†æˆå¤šç§åˆ†æå·¥å…·
â€¢ å­˜å‚¨ç®¡ç†å±‚ï¼šå†å²æ•°æ®å’Œå®æ—¶æ•°æ®åˆ†ç¦»
â€¢ åº”ç”¨æœåŠ¡å±‚ï¼šæä¾›APIå’Œè‡ªåŠ¨åŒ–èƒ½åŠ›
â€¢ å±•ç¤ºäº¤äº’å±‚ï¼šå¤šç»ˆç«¯æ”¯æŒå’Œå¯è§†åŒ–
```

**ğŸ”¹ è‡ªåŠ¨åŒ–æµç¨‹æ ‡å‡†åŒ–**
```
æµç¨‹è¦ç´ ï¼š
â€¢ è§¦å‘æœºåˆ¶ï¼šå¤šç§è§¦å‘æ–¹å¼ç»“åˆ
â€¢ å¤„ç†æµç¨‹ï¼šæ ‡å‡†åŒ–å’Œå¯å®šåˆ¶å¹¶é‡
â€¢ ç»“æœè¾“å‡ºï¼šå¤šæ ¼å¼å¤šæ¸ é“æ”¯æŒ
â€¢ åç»­è·Ÿè¸ªï¼šæ•ˆæœéªŒè¯å’ŒæŒç»­æ”¹è¿›
```

### 13.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **æ—¥å¸¸è¿ç»´**ï¼šå®šæœŸæ…¢æŸ¥è¯¢åˆ†æå’Œæ€§èƒ½å·¡æ£€
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ·±åº¦åˆ†æå’Œä¼˜åŒ–æ–¹æ¡ˆåˆ¶å®š
- **æ•…éšœå¤„ç†**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³æ€§èƒ½é—®é¢˜
- **å®¹é‡è§„åˆ’**ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹èµ„æºéœ€æ±‚

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**
```
å·¥å…·ä½¿ç”¨ç­–ç•¥ï¼š
1. å…¥é—¨é˜¶æ®µï¼šä»mysqldumpslowå¼€å§‹å­¦ä¹ 
2. è¿›é˜¶é˜¶æ®µï¼šæŒæ¡pt-query-digestæ·±åº¦åˆ†æ
3. é«˜çº§é˜¶æ®µï¼šç»“åˆPerformance Schemaå®æ—¶ç›‘æ§
4. ä¸“å®¶é˜¶æ®µï¼šæ„å»ºè‡ªåŠ¨åŒ–åˆ†æå¹³å°

å¹³å°å»ºè®¾åŸåˆ™ï¼š
â€¢ ä»ç®€å•åˆ°å¤æ‚ï¼Œé€æ­¥å®Œå–„
â€¢ å·¥å…·æ•´åˆä¼˜äºå•ä¸€å·¥å…·
â€¢ è‡ªåŠ¨åŒ–ç¨‹åº¦é€æ­¥æå‡
â€¢ æ³¨é‡æ•°æ®å®‰å…¨å’Œæƒé™æ§åˆ¶

é¿å…å¸¸è§è¯¯åŒºï¼š
âŒ ä¸è¦åªä¾èµ–å•ä¸€å·¥å…·è¿›è¡Œåˆ†æ
âŒ ä¸è¦å¿½è§†å®æ—¶ç›‘æ§çš„é‡è¦æ€§
âŒ ä¸è¦è¿‡åº¦å¤æ‚åŒ–åˆ†æå¹³å°
âŒ ä¸è¦å¿½ç•¥åˆ†æç»“æœçš„è½åœ°æ‰§è¡Œ
```

**ğŸ“Š æŠ€èƒ½å‘å±•è·¯å¾„**
```
åŸºç¡€æŠ€èƒ½ï¼š
â€¢ ç†Ÿç»ƒä½¿ç”¨mysqldumpslowè¿›è¡ŒåŸºç¡€åˆ†æ
â€¢ ç†è§£æ…¢æŸ¥è¯¢æ—¥å¿—æ ¼å¼å’ŒåŸºæœ¬æŒ‡æ ‡

è¿›é˜¶æŠ€èƒ½ï¼š  
â€¢ æŒæ¡pt-query-digesté«˜çº§åˆ†æåŠŸèƒ½
â€¢ èƒ½å¤Ÿè®¾è®¡å’Œå®æ–½ç›‘æ§ç­–ç•¥

é«˜çº§æŠ€èƒ½ï¼š
â€¢ æ„å»ºè‡ªåŠ¨åŒ–åˆ†æå’Œç›‘æ§å¹³å°
â€¢ é›†æˆå¤šç§å·¥å…·å½¢æˆå·¥å…·é“¾

ä¸“å®¶æŠ€èƒ½ï¼š
â€¢ åŸºäºæœºå™¨å­¦ä¹ çš„æ™ºèƒ½åˆ†æ
â€¢ å¤§è§„æ¨¡åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ç›‘æ§ä½“ç³»
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- å·¥å…·é€‰æ‹©çœ‹éœ€æ±‚ï¼ŒåŸºç¡€ç”¨dumpslowï¼Œæ·±åº¦ç”¨digest
- å®æ—¶ç›‘æ§ç”¨Schemaï¼Œå¹³å°å»ºè®¾è¦æ•´åˆ
- è‡ªåŠ¨åŒ–æµç¨‹æ ‡å‡†åŒ–ï¼Œæ•ˆæœéªŒè¯è¦è·Ÿè¸ª
- ä»ç®€å•åˆ°å¤æ‚ï¼ŒæŒç»­ä¼˜åŒ–ä¸åœæ­¥