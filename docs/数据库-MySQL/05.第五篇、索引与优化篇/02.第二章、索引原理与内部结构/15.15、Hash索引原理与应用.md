---
title: 15ã€Hashç´¢å¼•åŸç†ä¸åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [Hashç´¢å¼•åŸºç¡€æ¦‚å¿µ](#1-Hashç´¢å¼•åŸºç¡€æ¦‚å¿µ)
2. [å“ˆå¸Œå‡½æ•°è®¾è®¡åŸç†](#2-å“ˆå¸Œå‡½æ•°è®¾è®¡åŸç†)
3. [å“ˆå¸Œå†²çªå¤„ç†æœºåˆ¶](#3-å“ˆå¸Œå†²çªå¤„ç†æœºåˆ¶)
4. [Hashç´¢å¼•å†…å­˜ç®¡ç†](#4-Hashç´¢å¼•å†…å­˜ç®¡ç†)
5. [Hashç´¢å¼•æ€§èƒ½ç‰¹æ€§](#5-Hashç´¢å¼•æ€§èƒ½ç‰¹æ€§)
6. [Hashç´¢å¼•é€‚ç”¨åœºæ™¯](#6-Hashç´¢å¼•é€‚ç”¨åœºæ™¯)
7. [Hashç´¢å¼•ä¸B+æ ‘å¯¹æ¯”](#7-Hashç´¢å¼•ä¸B+æ ‘å¯¹æ¯”)
8. [Hashç´¢å¼•ä¼˜åŒ–å®æˆ˜](#8-Hashç´¢å¼•ä¼˜åŒ–å®æˆ˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”‘ Hashç´¢å¼•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Hashç´¢å¼•


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
```
Hashç´¢å¼•ï¼šåŸºäºå“ˆå¸Œè¡¨æ•°æ®ç»“æ„å®ç°çš„æ•°æ®åº“ç´¢å¼•
æ ¸å¿ƒæ€æƒ³ï¼šé€šè¿‡å“ˆå¸Œå‡½æ•°å°†ç´¢å¼•é”®æ˜ å°„åˆ°å“ˆå¸Œè¡¨çš„ä½ç½®
æŸ¥æ‰¾æ–¹å¼ï¼šç›´æ¥å®šä½ï¼Œæ— éœ€éå†
æ—¶é—´å¤æ‚åº¦ï¼šç†æƒ³æƒ…å†µä¸‹O(1)
```

**ğŸ’¡ ç”Ÿæ´»åŒ–ç†è§£**
Hashç´¢å¼•å°±åƒæ˜¯**"å›¾ä¹¦é¦†çš„è—ä¹¦å¡ç‰‡"**ï¼š
- **ä¼ ç»Ÿç´¢å¼•ï¼ˆB+æ ‘ï¼‰**ï¼šåƒæ˜¯æŒ‰å­—æ¯é¡ºåºæ’åˆ—çš„å¡ç‰‡æŸœï¼Œè¦æ‰¾ä¹¦éœ€è¦ç¿»æ‰¾
- **Hashç´¢å¼•**ï¼šåƒæ˜¯æœ‰ä¸ªé­”æ³•ç›’å­ï¼ŒæŠ¥å‡ºä¹¦åå°±èƒ½ç›´æ¥å¼¹å‡ºä½ç½®å¡ç‰‡
- **ä¼˜åŠ¿**ï¼šæŸ¥æ‰¾é€Ÿåº¦è¶…å¿«
- **é™åˆ¶**ï¼šåªèƒ½ç²¾ç¡®æŸ¥æ‰¾ï¼Œä¸èƒ½èŒƒå›´æŸ¥æ‰¾

### 1.2 Hashç´¢å¼•å·¥ä½œåŸç†


**ğŸ”§ åŸºæœ¬å·¥ä½œæµç¨‹**
```
æ­¥éª¤ä¸€ï¼šå“ˆå¸Œè®¡ç®—
ç´¢å¼•é”®å€¼ â†’ å“ˆå¸Œå‡½æ•° â†’ å“ˆå¸Œå€¼

æ­¥éª¤äºŒï¼šä½ç½®æ˜ å°„  
å“ˆå¸Œå€¼ â†’ å–æ¨¡è¿ç®— â†’ å“ˆå¸Œè¡¨æ§½ä½

æ­¥éª¤ä¸‰ï¼šæ•°æ®å­˜å‚¨
æ§½ä½ â†’ å­˜å‚¨è¡ŒæŒ‡é’ˆæˆ–è¡Œæ•°æ®

æ­¥éª¤å››ï¼šæŸ¥è¯¢å®šä½
æŸ¥è¯¢å€¼ â†’ ç›¸åŒå“ˆå¸Œè®¡ç®— â†’ ç›´æ¥å®šä½æ§½ä½
```

**ğŸ“Š Hashç´¢å¼•ç»“æ„å›¾**
```
                    å“ˆå¸Œå‡½æ•°
ç´¢å¼•é”®å€¼  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  å“ˆå¸Œå€¼  â”€â”€â”€â”€â–¶  æ§½ä½
                h(key)                    mod N

å“ˆå¸Œè¡¨ç»“æ„ï¼š
æ§½ä½0: [key1, ptr1] â†’ [key5, ptr5] â†’ NULL
æ§½ä½1: [key2, ptr2] â†’ NULL  
æ§½ä½2: [key3, ptr3] â†’ [key7, ptr7] â†’ [key9, ptr9] â†’ NULL
æ§½ä½3: NULL
æ§½ä½4: [key4, ptr4] â†’ NULL

è¯´æ˜ï¼š
â€¢ æ¯ä¸ªæ§½ä½æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ˆå¤„ç†å†²çªï¼‰
â€¢ ptræŒ‡å‘å®é™…æ•°æ®è¡Œçš„ä½ç½®
â€¢ å†²çªçš„é”®å€¼åœ¨åŒä¸€æ§½ä½å½¢æˆé“¾è¡¨
```

### 1.3 Hashç´¢å¼•ç‰¹ç‚¹æ€»ç»“


**âœ… Hashç´¢å¼•ä¼˜åŠ¿**
```
æŸ¥æ‰¾é€Ÿåº¦æå¿«ï¼š
â€¢ ç†æƒ³æƒ…å†µO(1)æ—¶é—´å¤æ‚åº¦
â€¢ æ— éœ€æ ‘éå†ï¼Œç›´æ¥å®šä½
â€¢ é€‚åˆé«˜é¢‘ç²¾ç¡®æŸ¥è¯¢

å†…å­˜æ•ˆç‡é«˜ï¼š
â€¢ ç»“æ„ç®€å•ï¼Œå†…å­˜å ç”¨å°
â€¢ æ— éœ€ç»´æŠ¤æ ‘ç»“æ„
â€¢ ç¼“å­˜å‹å¥½ï¼Œå±€éƒ¨æ€§å¥½

å®ç°ç›¸å¯¹ç®€å•ï¼š
â€¢ ç®—æ³•é€»è¾‘æ¸…æ™°
â€¢ ç»´æŠ¤æˆæœ¬è¾ƒä½
```

**âŒ Hashç´¢å¼•é™åˆ¶**
```
æŸ¥è¯¢ç±»å‹å—é™ï¼š
â€¢ ä»…æ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼ˆ=, INï¼‰
â€¢ ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆ>, <, BETWEENï¼‰
â€¢ ä¸æ”¯æŒæ’åºæ“ä½œï¼ˆORDER BYï¼‰
â€¢ ä¸æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼ˆLIKEï¼‰

æ•°æ®åˆ†å¸ƒæ•æ„Ÿï¼š
â€¢ å“ˆå¸Œå†²çªå½±å“æ€§èƒ½
â€¢ æ•°æ®å€¾æ–œå¯¼è‡´çƒ­ç‚¹
â€¢ æ‰©å®¹ç›¸å¯¹å¤æ‚

å­˜å‚¨å¼•æ“é™åˆ¶ï¼š
â€¢ ä¸»è¦åœ¨Memoryå¼•æ“ä¸­ä½¿ç”¨
â€¢ InnoDBä¸ç›´æ¥æ”¯æŒç”¨æˆ·Hashç´¢å¼•
â€¢ MyISAMæœ‰é™æ”¯æŒ
```

---

## 2. ğŸ² å“ˆå¸Œå‡½æ•°è®¾è®¡åŸç†


### 2.1 å“ˆå¸Œå‡½æ•°çš„ä½œç”¨


**ğŸ¯ å“ˆå¸Œå‡½æ•°æ ¸å¿ƒè¦æ±‚**
```
å‡åŒ€åˆ†å¸ƒï¼šä¸åŒçš„é”®å€¼åº”è¯¥å‡åŒ€åˆ†å¸ƒåˆ°å„ä¸ªæ§½ä½
ç¡®å®šæ€§ï¼šç›¸åŒçš„è¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„è¾“å‡º
é«˜æ•ˆæ€§ï¼šè®¡ç®—é€Ÿåº¦è¦å¿«ï¼Œä¸èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
æŠ—å†²çªæ€§ï¼šå°½é‡å‡å°‘ä¸åŒé”®å€¼äº§ç”Ÿç›¸åŒå“ˆå¸Œå€¼
```

**ğŸ’¡ å¥½åå“ˆå¸Œå‡½æ•°å¯¹æ¯”**
```
åçš„å“ˆå¸Œå‡½æ•°ç¤ºä¾‹ï¼š
h(x) = x % 4

è¾“å…¥ï¼š[4, 8, 12, 16, 20]
è¾“å‡ºï¼š[0, 0, 0, 0, 0]  â† å…¨éƒ¨å†²çªï¼

å¥½çš„å“ˆå¸Œå‡½æ•°ç¤ºä¾‹ï¼š
h(x) = (x * 31 + 17) % 4  

è¾“å…¥ï¼š[4, 8, 12, 16, 20]
è¾“å‡ºï¼š[1, 1, 3, 1, 3]  â† åˆ†å¸ƒç›¸å¯¹å‡åŒ€
```

### 2.2 å¸¸ç”¨å“ˆå¸Œå‡½æ•°ç®—æ³•


**ğŸ”¢ æ•°å€¼ç±»å‹å“ˆå¸Œ**
```java
// æ•´æ•°å“ˆå¸Œ - ä¹˜æ³•æ•£åˆ—
public int integerHash(int key, int tableSize) {
    // é»„é‡‘æ¯”ä¾‹å¸¸æ•°ï¼Œåˆ†å¸ƒæ•ˆæœå¥½
    final int GOLDEN_RATIO = 0x61C88647;
    return ((key * GOLDEN_RATIO) >>> 16) % tableSize;
}

// æµ®ç‚¹æ•°å“ˆå¸Œ
public int floatHash(float key, int tableSize) {
    int bits = Float.floatToIntBits(key);
    return integerHash(bits, tableSize);
}
```

**ğŸ”¤ å­—ç¬¦ä¸²å“ˆå¸Œç®—æ³•**
```java
// DJBå“ˆå¸Œç®—æ³• - ç®€å•é«˜æ•ˆ
public int djbHash(String str, int tableSize) {
    int hash = 5381;
    for (char c : str.toCharArray()) {
        hash = ((hash << 5) + hash) + c; // hash * 33 + c
    }
    return Math.abs(hash) % tableSize;
}

// FNVå“ˆå¸Œç®—æ³• - åˆ†å¸ƒæ€§å¥½
public int fnvHash(String str, int tableSize) {
    final int FNV_PRIME = 16777619;
    final int FNV_OFFSET = 2166136261;
    
    int hash = FNV_OFFSET;
    for (byte b : str.getBytes()) {
        hash = (hash * FNV_PRIME) ^ b;
    }
    return Math.abs(hash) % tableSize;
}
```

### 2.3 å“ˆå¸Œå‡½æ•°æ€§èƒ½æµ‹è¯•


**ğŸ“Š åˆ†å¸ƒå‡åŒ€æ€§æµ‹è¯•**
```java
public class HashFunctionTester {
    
    public void testDistribution(String[] testKeys, int tableSize) {
        int[] bucketCounts = new int[tableSize];
        
        // ç»Ÿè®¡æ¯ä¸ªæ¡¶çš„é”®å€¼æ•°é‡
        for (String key : testKeys) {
            int bucket = djbHash(key, tableSize);
            bucketCounts[bucket]++;
        }
        
        // è®¡ç®—åˆ†å¸ƒå‡åŒ€æ€§
        double average = (double)testKeys.length / tableSize;
        double variance = 0.0;
        
        for (int count : bucketCounts) {
            variance += Math.pow(count - average, 2);
        }
        variance /= tableSize;
        
        System.out.println("å¹³å‡æ¯æ¡¶: " + average);
        System.out.println("åˆ†å¸ƒæ–¹å·®: " + variance);
        System.out.println("å‡åŒ€æ€§å¾—åˆ†: " + (1.0 / (1.0 + variance)));
    }
}
```

---

## 3. âš”ï¸ å“ˆå¸Œå†²çªå¤„ç†æœºåˆ¶


### 3.1 å“ˆå¸Œå†²çªäº§ç”ŸåŸå› 


**ğŸ”¸ å†²çªçš„å¿…ç„¶æ€§**
```
é¸½ç¬¼åŸç†ï¼š
â€¢ å¦‚æœæœ‰n+1åªé¸½å­è¦æ”¾è¿›nä¸ªé¸½ç¬¼
â€¢ è‡³å°‘æœ‰ä¸€ä¸ªé¸½ç¬¼ä¼šæœ‰ä¸¤åªä»¥ä¸Šçš„é¸½å­
â€¢ ç±»æ¯”ï¼šé”®å€¼ç©ºé—´å¤§äºå“ˆå¸Œè¡¨å¤§å°æ—¶ï¼Œå¿…ç„¶äº§ç”Ÿå†²çª

å®é™…ä¾‹å­ï¼š
å“ˆå¸Œè¡¨å¤§å°ï¼š1000ä¸ªæ§½ä½
å¯èƒ½çš„é”®å€¼ï¼šæ‰‹æœºå·ç ï¼ˆ11ä½æ•°å­—ï¼Œçº¦10^11ç§å¯èƒ½ï¼‰
ç»“è®ºï¼šæ— è®ºå“ˆå¸Œå‡½æ•°å¤šå¥½ï¼Œå†²çªéƒ½ä¸å¯é¿å…
```

### 3.2 é“¾åœ°å€æ³•å†²çªè§£å†³


**ğŸ”— é“¾åœ°å€æ³•ï¼ˆæ‹‰é“¾æ³•ï¼‰åŸç†**
```
åŸºæœ¬æ€æƒ³ï¼šæ¯ä¸ªå“ˆå¸Œè¡¨æ§½ä½ç»´æŠ¤ä¸€ä¸ªé“¾è¡¨ï¼Œå†²çªçš„å…ƒç´ éƒ½æ”¾åœ¨é“¾è¡¨ä¸­

ä¼˜åŠ¿ï¼š
â€¢ å®ç°ç®€å•ç›´è§‚
â€¢ å¯¹å“ˆå¸Œå‡½æ•°è¦æ±‚ä¸ä¸¥æ ¼
â€¢ æ”¯æŒåŠ¨æ€æ‰©å®¹
â€¢ åˆ é™¤æ“ä½œå®¹æ˜“

ç¼ºç‚¹ï¼š
â€¢ éœ€è¦é¢å¤–æŒ‡é’ˆå­˜å‚¨å¼€é”€
â€¢ æœ€åæƒ…å†µé€€åŒ–ä¸ºé“¾è¡¨æŸ¥æ‰¾O(n)
â€¢ ç¼“å­˜å±€éƒ¨æ€§è¾ƒå·®
```

**ğŸ—ï¸ é“¾åœ°å€æ³•å®ç°ç»“æ„**
```
å“ˆå¸Œè¡¨ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ [0] â”‚ [1] â”‚ [2] â”‚ [3] â”‚ [4] â”‚  â† å“ˆå¸Œè¡¨æ§½ä½æ•°ç»„
â””â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”˜
   â”‚     â”‚           â”‚
   â–¼     â–¼           â–¼
 â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”       â”Œâ”€â”€â”€â”
 â”‚k1 â”‚ â”‚k6 â”‚       â”‚k3 â”‚ â†’ â”Œâ”€â”€â”€â” â†’ â”Œâ”€â”€â”€â”
 â”‚v1 â”‚ â”‚v6 â”‚       â”‚v3 â”‚   â”‚k7 â”‚   â”‚k11â”‚
 â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜       â””â”€â”€â”€â”˜   â”‚v7 â”‚   â”‚v11â”‚
                           â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜

è¯´æ˜ï¼šæ§½ä½0ã€1åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæ§½ä½3å½¢æˆäº†å†²çªé“¾è¡¨
```

**ğŸ’» é“¾åœ°å€æ³•å®ç°**
```java
public class ChainedHashIndex<K, V> {
    private Node<K, V>[] table;
    private int size;
    private int capacity;
    
    static class Node<K, V> {
        K key;
        V value;
        Node<K, V> next;
        
        Node(K key, V value) {
            this.key = key;
            this.value = value;
        }
    }
    
    public V get(K key) {
        int bucket = hash(key) % capacity;
        Node<K, V> node = table[bucket];
        
        // éå†é“¾è¡¨æŸ¥æ‰¾
        while (node != null) {
            if (node.key.equals(key)) {
                return node.value;
            }
            node = node.next;
        }
        return null;
    }
    
    public void put(K key, V value) {
        int bucket = hash(key) % capacity;
        Node<K, V> node = table[bucket];
        
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        while (node != null) {
            if (node.key.equals(key)) {
                node.value = value; // æ›´æ–°å€¼
                return;
            }
            node = node.next;
        }
        
        // æ–°å¢èŠ‚ç‚¹åˆ°é“¾è¡¨å¤´éƒ¨
        Node<K, V> newNode = new Node<>(key, value);
        newNode.next = table[bucket];
        table[bucket] = newNode;
        size++;
    }
}
```

### 3.3 å¼€æ”¾åœ°å€æ³•å®ç°


**ğŸ”“ å¼€æ”¾åœ°å€æ³•åŸç†**
```
åŸºæœ¬æ€æƒ³ï¼šæ‰€æœ‰å…ƒç´ éƒ½å­˜å‚¨åœ¨å“ˆå¸Œè¡¨æ•°ç»„ä¸­ï¼Œå†²çªæ—¶å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºä½

å¸¸è§æ¢æµ‹æ–¹å¼ï¼š
â€¢ çº¿æ€§æ¢æµ‹ï¼šh(k,i) = (h'(k) + i) % m
â€¢ äºŒæ¬¡æ¢æµ‹ï¼šh(k,i) = (h'(k) + iÂ²) % m  
â€¢ åŒæ•£åˆ—ï¼šh(k,i) = (h1(k) + i*h2(k)) % m

ä¼˜åŠ¿ï¼š
â€¢ ä¸éœ€è¦é¢å¤–æŒ‡é’ˆï¼ŒèŠ‚çœå†…å­˜
â€¢ ç¼“å­˜å‹å¥½ï¼Œæ•°æ®ç´§å¯†å­˜å‚¨
â€¢ é¿å…å†…å­˜ç¢ç‰‡

ç¼ºç‚¹ï¼š
â€¢ åˆ é™¤æ“ä½œå¤æ‚ï¼ˆéœ€è¦æ ‡è®°åˆ é™¤ï¼‰
â€¢ è½½è·å› å­ä¸èƒ½å¤ªé«˜
â€¢ èšé›†ç°è±¡å¯èƒ½å½±å“æ€§èƒ½
```

**ğŸ¯ çº¿æ€§æ¢æµ‹å®ç°**
```java
public class LinearProbingHashIndex<K, V> {
    private K[] keys;
    private V[] values;
    private boolean[] deleted;
    private int size;
    private int capacity;
    
    public V get(K key) {
        int pos = hash(key) % capacity;
        
        // çº¿æ€§æ¢æµ‹æŸ¥æ‰¾
        while (keys[pos] != null) {
            if (!deleted[pos] && keys[pos].equals(key)) {
                return values[pos];
            }
            pos = (pos + 1) % capacity; // çº¿æ€§æ¢æµ‹ä¸‹ä¸€ä½
        }
        return null;
    }
    
    public void put(K key, V value) {
        // è½½è·å› å­è¿‡é«˜æ—¶æ‰©å®¹
        if (size >= capacity * 0.75) {
            resize();
        }
        
        int pos = hash(key) % capacity;
        
        // çº¿æ€§æ¢æµ‹æ‰¾åˆ°ç©ºä½æˆ–ç›¸åŒkey
        while (keys[pos] != null && !deleted[pos]) {
            if (keys[pos].equals(key)) {
                values[pos] = value; // æ›´æ–°
                return;
            }
            pos = (pos + 1) % capacity;
        }
        
        // æ‰¾åˆ°ç©ºä½ï¼Œæ’å…¥æ–°å…ƒç´ 
        keys[pos] = key;
        values[pos] = value;
        deleted[pos] = false;
        size++;
    }
}
```

### 3.4 å†²çªå¤„ç†æ€§èƒ½å¯¹æ¯”


| å¤„ç†æ–¹å¼ | **å†…å­˜æ•ˆç‡** | **æŸ¥æ‰¾æ€§èƒ½** | **æ’å…¥æ€§èƒ½** | **åˆ é™¤å¤æ‚åº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|--------------|-------------|
| ğŸ”— **é“¾åœ°å€æ³•** | `ä¸€èˆ¬` | `å¹³å‡O(1)` | `O(1)` | `ç®€å•` | `å†²çªç‡é«˜çš„åœºæ™¯` |
| ğŸ”“ **çº¿æ€§æ¢æµ‹** | `ä¼˜ç§€` | `ç¼“å­˜å‹å¥½` | `ä¸€èˆ¬` | `å¤æ‚` | `å†…å­˜æ•æ„Ÿåœºæ™¯` |
| ğŸ¯ **äºŒæ¬¡æ¢æµ‹** | `ä¼˜ç§€` | `é¿å…èšé›†` | `ä¸€èˆ¬` | `å¤æ‚` | `ä¸­ç­‰å†²çªåœºæ™¯` |
| ğŸ”„ **åŒæ•£åˆ—** | `ä¼˜ç§€` | `åˆ†å¸ƒå‡åŒ€` | `è¾ƒæ…¢` | `æœ€å¤æ‚` | `é«˜è´¨é‡éœ€æ±‚` |

---

## 4. ğŸ’¾ Hashç´¢å¼•å†…å­˜ç®¡ç†


### 4.1 å†…å­˜Hashç´¢å¼•ç‰¹ç‚¹


**ğŸ”¸ Memoryå¼•æ“Hashç´¢å¼•**
```
å­˜å‚¨ä½ç½®ï¼šå®Œå…¨åœ¨å†…å­˜ä¸­ï¼Œä¸æŒä¹…åŒ–åˆ°ç£ç›˜
è®¿é—®é€Ÿåº¦ï¼šæå¿«ï¼Œæ— ç£ç›˜IOå¼€é”€
ç”Ÿå‘½å‘¨æœŸï¼šéšMySQLé‡å¯è€Œä¸¢å¤±
é€‚ç”¨åœºæ™¯ï¼šä¸´æ—¶è¡¨ã€ç¼“å­˜è¡¨ã€ä¼šè¯æ•°æ®

å†…å­˜å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MySQL Memory          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Hashç´¢å¼•åŒºåŸŸ         â”‚   â”‚ â† ç´¢å¼•æ•°æ®
â”‚  â”‚ [æ§½ä½0][æ§½ä½1][æ§½ä½2]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    è¡¨æ•°æ®åŒºåŸŸ           â”‚   â”‚ â† å®é™…è¡Œæ•°æ®
â”‚  â”‚ [è¡Œ1][è¡Œ2][è¡Œ3][è¡Œ4]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å“ˆå¸Œè¡¨æ‰©å®¹æœºåˆ¶


**ğŸ“ˆ åŠ¨æ€æ‰©å®¹ç­–ç•¥**
```
æ‰©å®¹è§¦å‘æ¡ä»¶ï¼š
â€¢ è½½è·å› å­ = å…ƒç´ æ•°é‡ / å“ˆå¸Œè¡¨å¤§å°
â€¢ é“¾åœ°å€æ³•ï¼šè½½è·å› å­ > 0.75
â€¢ å¼€æ”¾åœ°å€æ³•ï¼šè½½è·å› å­ > 0.5

æ‰©å®¹è¿‡ç¨‹ï¼š
â‘  åˆ›å»ºæ–°çš„æ›´å¤§å“ˆå¸Œè¡¨ï¼ˆé€šå¸¸2å€å¤§å°ï¼‰
â‘¡ é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ çš„å“ˆå¸Œå€¼
â‘¢ å°†å…ƒç´ è¿ç§»åˆ°æ–°è¡¨ä¸­
â‘£ é‡Šæ”¾æ—§è¡¨å†…å­˜
```

**ğŸ”„ æ‰©å®¹å®ç°ç­–ç•¥**
```java
public void resize() {
    K[] oldKeys = keys;
    V[] oldValues = values;
    int oldCapacity = capacity;
    
    // æ‰©å®¹åˆ°2å€å¤§å°
    capacity = capacity * 2;
    keys = (K[]) new Object[capacity];
    values = (V[]) new Object[capacity];
    deleted = new boolean[capacity];
    size = 0;
    
    // é‡æ–°å“ˆå¸Œæ‰€æœ‰å…ƒç´ 
    for (int i = 0; i < oldCapacity; i++) {
        if (oldKeys[i] != null) {
            put(oldKeys[i], oldValues[i]);
        }
    }
}
```

**âš¡ æ¸è¿›å¼æ‰©å®¹ä¼˜åŒ–**
```java
// é¿å…ä¸€æ¬¡æ€§æ‰©å®¹é€ æˆçš„å»¶è¿Ÿå³°å€¼
public class IncrementalHashIndex {
    private boolean isResizing = false;
    private int migratedBuckets = 0;
    
    public V get(K key) {
        V result = getFromNewTable(key);
        if (result != null || !isResizing) {
            return result;
        }
        return getFromOldTable(key); // æ‰©å®¹æœŸé—´æŸ¥ä¸¤ä¸ªè¡¨
    }
    
    public void put(K key, V value) {
        // æ¯æ¬¡æ’å…¥éƒ½è¿ç§»å‡ ä¸ªæ—§æ¡¶
        if (isResizing) {
            migrateSomeBuckets(5); // æ¯æ¬¡è¿ç§»5ä¸ªæ¡¶
        }
        
        putToNewTable(key, value);
    }
}
```

### 4.3 å†…å­˜ç®¡ç†ä¼˜åŒ–


**ğŸ§  å†…å­˜åˆ†é…ç­–ç•¥**
```
é¢„åˆ†é…ç­–ç•¥ï¼š
â€¢ æ ¹æ®é¢„ä¼°æ•°æ®é‡é¢„å…ˆåˆ†é…å†…å­˜
â€¢ é¿å…é¢‘ç¹çš„å°å—å†…å­˜åˆ†é…
â€¢ å‡å°‘å†…å­˜ç¢ç‰‡äº§ç”Ÿ

å†…å­˜æ± æŠ€æœ¯ï¼š
â€¢ é¢„å…ˆç”³è¯·å¤§å—å†…å­˜
â€¢ æŒ‰éœ€åˆ†é…å°å—ç»™å“ˆå¸ŒèŠ‚ç‚¹
â€¢ ç»Ÿä¸€å›æ”¶ï¼Œæé«˜æ•ˆç‡

ç¼“å­˜ä¼˜åŒ–ï¼š
â€¢ å“ˆå¸Œè¡¨æŒ‰ç¼“å­˜è¡Œå¯¹é½
â€¢ çƒ­ç‚¹æ•°æ®ä¼˜å…ˆæ”¾åœ¨L1ç¼“å­˜ä¸­
â€¢ å‡å°‘ç¼“å­˜å¤±æ•ˆæ¬¡æ•°
```

---

## 5. âš¡ Hashç´¢å¼•æ€§èƒ½ç‰¹æ€§


### 5.1 ç²¾ç¡®åŒ¹é…ä¼˜åŠ¿


**ğŸ¯ ç­‰å€¼æŸ¥è¯¢æ€§èƒ½åˆ†æ**
```
Hashç´¢å¼•ç­‰å€¼æŸ¥è¯¢æ­¥éª¤ï¼š
â‘  è®¡ç®—æŸ¥è¯¢å€¼çš„å“ˆå¸Œå€¼ï¼šO(1)
â‘¡ å®šä½åˆ°å“ˆå¸Œè¡¨æ§½ä½ï¼šO(1)  
â‘¢ åœ¨æ§½ä½é“¾è¡¨ä¸­æŸ¥æ‰¾ï¼šå¹³å‡O(1)ï¼Œæœ€åO(n)

æ€§èƒ½ç‰¹ç‚¹ï¼š
â€¢ æœ€ä½³æƒ…å†µï¼šO(1) - æ— å†²çªç›´æ¥å‘½ä¸­
â€¢ å¹³å‡æƒ…å†µï¼šO(1) - å†²çªé“¾è¡¨å¾ˆçŸ­
â€¢ æœ€åæƒ…å†µï¼šO(n) - æ‰€æœ‰å…ƒç´ éƒ½å†²çªåˆ°ä¸€ä¸ªæ§½ä½

å®é™…æ€§èƒ½ï¼š
â€¢ è½½è·å› å­0.75æ—¶ï¼Œå¹³å‡æŸ¥æ‰¾æ¬¡æ•°çº¦1.5æ¬¡
â€¢ è½½è·å› å­0.5æ—¶ï¼Œå¹³å‡æŸ¥æ‰¾æ¬¡æ•°çº¦1.25æ¬¡
```

**ğŸ“Š æ€§èƒ½æµ‹è¯•å¯¹æ¯”**
```java
public class HashIndexPerformanceTest {
    
    public void compareSearchPerformance() {
        // æµ‹è¯•æ•°æ®ï¼š100ä¸‡æ¡è®°å½•
        int dataSize = 1_000_000;
        String[] testKeys = generateTestData(dataSize);
        
        // Hashç´¢å¼•æŸ¥æ‰¾
        long startTime = System.nanoTime();
        for (String key : testKeys) {
            hashIndex.get(key); // å¹³å‡0.001ms
        }
        long hashTime = System.nanoTime() - startTime;
        
        // B+æ ‘ç´¢å¼•æŸ¥æ‰¾  
        startTime = System.nanoTime();
        for (String key : testKeys) {
            btreeIndex.get(key); // å¹³å‡0.01ms (éœ€è¦æ ‘éå†)
        }
        long btreeTime = System.nanoTime() - startTime;
        
        System.out.println("Hashç´¢å¼•å¹³å‡æŸ¥æ‰¾æ—¶é—´: " + hashTime / dataSize + " ns");
        System.out.println("B+æ ‘ç´¢å¼•å¹³å‡æŸ¥æ‰¾æ—¶é—´: " + btreeTime / dataSize + " ns");
        // Hashç´¢å¼•é€šå¸¸æ¯”B+æ ‘å¿«5-10å€
    }
}
```

### 5.2 èŒƒå›´æŸ¥è¯¢é™åˆ¶


**âŒ Hashç´¢å¼•ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢çš„åŸå› **
```
èŒƒå›´æŸ¥è¯¢ç¤ºä¾‹ï¼š
SELECT * FROM users WHERE age BETWEEN 25 AND 35;

Hashç´¢å¼•å¤„ç†è¿‡ç¨‹ï¼š
h(25) = 328
h(26) = 891  
h(27) = 156
h(28) = 743
...

é—®é¢˜åˆ†æï¼š
â€¢ ç›¸é‚»çš„å¹´é¾„å€¼å“ˆå¸Œååˆ†æ•£åœ¨ä¸åŒæ§½ä½
â€¢ æ— æ³•é€šè¿‡å“ˆå¸Œå€¼åˆ¤æ–­å¤§å°å…³ç³»
â€¢ å¿…é¡»æ‰«ææ•´ä¸ªå“ˆå¸Œè¡¨ï¼Œæ€§èƒ½O(n)
â€¢ æ¯”å…¨è¡¨æ‰«æè¿˜è¦æ…¢ï¼ˆè¿˜è¦è®¡ç®—å“ˆå¸Œï¼‰

ç»“è®ºï¼šHashç´¢å¼•å¯¹èŒƒå›´æŸ¥è¯¢æ¯«æ— å¸®åŠ©ï¼
```

**ğŸ” æ”¯æŒçš„æŸ¥è¯¢ç±»å‹**
```sql
-- âœ… Hashç´¢å¼•é«˜æ•ˆæ”¯æŒçš„æŸ¥è¯¢
SELECT * FROM users WHERE user_id = 12345;
SELECT * FROM products WHERE product_code = 'ABC123';
SELECT * FROM sessions WHERE session_id IN ('sess1', 'sess2', 'sess3');

-- âŒ Hashç´¢å¼•æ— æ³•ä¼˜åŒ–çš„æŸ¥è¯¢
SELECT * FROM users WHERE age > 25;
SELECT * FROM products WHERE price BETWEEN 100 AND 500;
SELECT * FROM logs WHERE created_at >= '2024-01-01';
SELECT * FROM users ORDER BY username;
SELECT * FROM products WHERE name LIKE '%phone%';
```

### 5.3 å¹¶å‘æ€§èƒ½ç‰¹ç‚¹


**ğŸ”€ å¹¶å‘è®¿é—®æ€§èƒ½**
```
Hashç´¢å¼•å¹¶å‘ä¼˜åŠ¿ï¼š
â€¢ è¯»æ“ä½œæ— é”ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–
â€¢ çƒ­ç‚¹åˆ†æ•£ï¼šä¸åŒé”®å€¼åˆ†å¸ƒåœ¨ä¸åŒæ§½ä½
â€¢ é”ç²’åº¦ç»†ï¼šå¯ä»¥æŒ‰æ§½ä½åŠ é”

å¹¶å‘æ§åˆ¶ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¯»å–é”    â”‚ â† å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ§½ä½é”    â”‚ â† åªé”å®šç‰¹å®šæ§½ä½ï¼Œå…¶ä»–æ§½ä½ä¸å—å½±å“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
â”‚   å†™å…¥é”    â”‚ â† å†™æ“ä½œéœ€è¦ç‹¬å é”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš™ï¸ å¹¶å‘ä¼˜åŒ–å®ç°**
```java
public class ConcurrentHashIndex<K, V> {
    private final Object[] locks; // åˆ†æ®µé”
    private final int lockCount = 32;
    
    public V get(K key) {
        // è¯»æ“ä½œæ— éœ€åŠ é”
        int bucket = hash(key) % capacity;
        return findInBucket(bucket, key);
    }
    
    public void put(K key, V value) {
        int bucket = hash(key) % capacity;
        int lockIndex = bucket % lockCount;
        
        synchronized (locks[lockIndex]) {
            // åªé”å®šå¯¹åº”çš„é”æ®µ
            putIntoBucket(bucket, key, value);
        }
    }
}
```

---

## 6. ğŸ¯ Hashç´¢å¼•é€‚ç”¨åœºæ™¯


### 6.1 é€‚ç”¨åœºæ™¯åˆ†æ


**âœ… Hashç´¢å¼•æœ€ä½³åº”ç”¨åœºæ™¯**
```
ä¼šè¯å­˜å‚¨ï¼š
â€¢ session_idç²¾ç¡®æŸ¥æ‰¾
â€¢ é«˜é¢‘è®¿é—®ï¼ŒæŸ¥è¯¢æ¨¡å¼å•ä¸€
â€¢ æ•°æ®ç”Ÿå‘½å‘¨æœŸçŸ­

ç¼“å­˜ç³»ç»Ÿï¼š
â€¢ cache_keyçš„å¿«é€Ÿå®šä½
â€¢ é«˜å¹¶å‘è¯»å†™
â€¢ å†…å­˜å­˜å‚¨ä¸ºä¸»

ç”¨æˆ·åœ¨çº¿çŠ¶æ€ï¼š
â€¢ user_idå¿«é€ŸæŸ¥æ‰¾åœ¨çº¿çŠ¶æ€
â€¢ é¢‘ç¹æ›´æ–°æ“ä½œ
â€¢ å®æ—¶æ€§è¦æ±‚é«˜

é…ç½®å‚æ•°è¡¨ï¼š
â€¢ config_keyçš„ç²¾ç¡®åŒ¹é…
â€¢ è¯»å¤šå†™å°‘
â€¢ æ•°æ®é‡ç›¸å¯¹å›ºå®š
```

**âŒ Hashç´¢å¼•ä¸é€‚ç”¨åœºæ™¯**
```
æŠ¥è¡¨åˆ†æï¼š
â€¢ éœ€è¦èŒƒå›´æŸ¥è¯¢å’Œæ’åº
â€¢ å¤æ‚çš„èšåˆæ“ä½œ
â€¢ æ•°æ®å…³è”æŸ¥è¯¢

æ—¥å¿—æŸ¥è¯¢ï¼š
â€¢ æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢
â€¢ æ¨¡ç³Šæœç´¢éœ€æ±‚
â€¢ æ•°æ®é‡å¤§ä¸”æŒç»­å¢é•¿

ä¸šåŠ¡ä¸»é”®ï¼š
â€¢ å¯èƒ½éœ€è¦èŒƒå›´æŸ¥è¯¢
â€¢ æ’åºæ˜¾ç¤ºéœ€æ±‚
â€¢ éœ€è¦æŒä¹…åŒ–å­˜å‚¨
```

### 6.2 å­˜å‚¨å¼•æ“æ”¯æŒæƒ…å†µ


**ğŸ—ƒï¸ å„å­˜å‚¨å¼•æ“Hashç´¢å¼•æ”¯æŒ**
```
MySQLå­˜å‚¨å¼•æ“å¯¹æ¯”ï¼š

Memoryå¼•æ“ï¼š
âœ… åŸç”Ÿæ”¯æŒHashç´¢å¼•
âœ… é»˜è®¤ç´¢å¼•ç±»å‹å°±æ˜¯Hash
âœ… æ€§èƒ½è¡¨ç°æœ€ä½³
âŒ æ•°æ®ä¸æŒä¹…åŒ–

InnoDBå¼•æ“ï¼š
âŒ ä¸æ”¯æŒæ˜¾å¼åˆ›å»ºHashç´¢å¼•
âœ… å†…éƒ¨ä½¿ç”¨è‡ªé€‚åº”Hashç´¢å¼•
âœ… è‡ªåŠ¨ä¸ºçƒ­ç‚¹é¡µé¢å»ºç«‹Hashç´¢å¼•
âœ… å¯¹ç”¨æˆ·é€æ˜

MyISAMå¼•æ“ï¼š
âŒ ä¸æ”¯æŒHashç´¢å¼•
âœ… åªæ”¯æŒB+æ ‘ç´¢å¼•
```

**âš™ï¸ Memoryå¼•æ“Hashç´¢å¼•é…ç½®**
```sql
-- åˆ›å»ºMemoryè¡¨å¹¶æŒ‡å®šHashç´¢å¼•
CREATE TABLE user_sessions (
    session_id VARCHAR(32) NOT NULL,
    user_id INT NOT NULL,
    login_time TIMESTAMP,
    last_activity TIMESTAMP,
    INDEX hash_session_id (session_id) USING HASH,
    INDEX hash_user_id (user_id) USING HASH
) ENGINE=Memory;

-- æŸ¥çœ‹ç´¢å¼•ç±»å‹
SHOW INDEX FROM user_sessions;
```

### 6.3 é€‚ç”¨åœºæ™¯å†³ç­–æ ‘


**ğŸŒ³ ç®—æ³•é€‰æ‹©å†³ç­–æµç¨‹**
```
å¼€å§‹
 â”‚
 â”œâ”€ æ˜¯å¦åªéœ€è¦ç²¾ç¡®åŒ¹é…ï¼Ÿ
 â”‚  â”œâ”€ æ˜¯ â”€â”€â”
 â”‚  â””â”€ å¦ â”€â”€ B+æ ‘ç´¢å¼•
 â”‚         â”‚
 â”‚         â”œâ”€ æ•°æ®æ˜¯å¦åœ¨å†…å­˜ä¸­ï¼Ÿ
 â”‚         â”‚  â”œâ”€ æ˜¯ â”€â”€ Memoryå¼•æ“ + Hashç´¢å¼• â­
 â”‚         â”‚  â””â”€ å¦ â”€â”€ InnoDB + B+æ ‘ç´¢å¼•
 â”‚         â”‚
 â”‚         â”œâ”€ æ˜¯å¦é«˜å¹¶å‘æŸ¥è¯¢ï¼Ÿ
 â”‚         â”‚  â”œâ”€ æ˜¯ â”€â”€ Hashç´¢å¼•ä¼˜å…ˆ
 â”‚         â”‚  â””â”€ å¦ â”€â”€ è€ƒè™‘å…¶ä»–å› ç´ 
 â”‚         â”‚
 â”‚         â””â”€ æ•°æ®é‡å¤§å°ï¼Ÿ
 â”‚            â”œâ”€ å°(<10ä¸‡) â”€â”€ Hashç´¢å¼•
 â”‚            â”œâ”€ ä¸­(10-100ä¸‡) â”€â”€ æ€§èƒ½æµ‹è¯•å†³å®š
 â”‚            â””â”€ å¤§(>100ä¸‡) â”€â”€ åˆ†ç‰‡Hashç´¢å¼•
```

---

## 7. âš–ï¸ Hashç´¢å¼•ä¸B+æ ‘å¯¹æ¯”


### 7.1 ç»¼åˆæ€§èƒ½å¯¹æ¯”


**ğŸ“Š è¯¦ç»†å¯¹æ¯”åˆ†æ**

| ç‰¹æ€§ç»´åº¦ | **Hashç´¢å¼•** | **B+æ ‘ç´¢å¼•** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| ğŸ” **ç­‰å€¼æŸ¥è¯¢** | `O(1) æå¿«` | `O(log n) è¾ƒå¿«` | `Hashç´¢å¼•ä¼˜åŠ¿æ˜æ˜¾` |
| ğŸ“ˆ **èŒƒå›´æŸ¥è¯¢** | `ä¸æ”¯æŒ` | `O(log n + k) é«˜æ•ˆ` | `B+æ ‘ç´¢å¼•å¿…éœ€` |
| ğŸ“Š **æ’åºæ”¯æŒ** | `ä¸æ”¯æŒ` | `å¤©ç„¶æœ‰åº` | `B+æ ‘ç´¢å¼•å¿…éœ€` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨** | `è¾ƒå°‘` | `è¾ƒå¤š` | `å†…å­˜æ•æ„Ÿé€‰Hash` |
| ğŸ”§ **ç»´æŠ¤æˆæœ¬** | `ä½` | `ä¸­ç­‰` | `ç®€å•åœºæ™¯é€‰Hash` |
| ğŸ”€ **å¹¶å‘æ€§èƒ½** | `å¾ˆå¥½` | `å¥½` | `é«˜å¹¶å‘é€‰Hash` |
| ğŸ’¿ **æŒä¹…åŒ–** | `Memoryå¼•æ“é™åˆ¶` | `å®Œå…¨æ”¯æŒ` | `æŒä¹…åŒ–é€‰B+æ ‘` |

### 7.2 å®é™…æ€§èƒ½æµ‹è¯•


**ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•**
```java
public class IndexPerformanceBenchmark {
    
    public void benchmarkLookupPerformance() {
        int testSize = 1_000_000;
        
        // Hashç´¢å¼•æµ‹è¯•
        long hashStartTime = System.nanoTime();
        for (int i = 0; i < testSize; i++) {
            hashIndex.get("key" + i);
        }
        long hashDuration = System.nanoTime() - hashStartTime;
        
        // B+æ ‘ç´¢å¼•æµ‹è¯•
        long btreeStartTime = System.nanoTime();
        for (int i = 0; i < testSize; i++) {
            btreeIndex.get("key" + i);
        }
        long btreeDuration = System.nanoTime() - btreeStartTime;
        
        System.out.printf("Hashç´¢å¼•å¹³å‡æŸ¥æ‰¾: %.2f ns%n", 
                         (double)hashDuration / testSize);
        System.out.printf("B+æ ‘ç´¢å¼•å¹³å‡æŸ¥æ‰¾: %.2f ns%n", 
                         (double)btreeDuration / testSize);
    }
    
    // å…¸å‹ç»“æœï¼šHashç´¢å¼•æ¯”B+æ ‘å¿«3-8å€ï¼ˆç­‰å€¼æŸ¥è¯¢ï¼‰
}
```

### 7.3 æ··åˆç´¢å¼•ç­–ç•¥


**ğŸ”€ ç»„åˆä½¿ç”¨æ–¹æ¡ˆ**
```sql
-- åœºæ™¯ï¼šç”¨æˆ·è¡¨éœ€è¦æ”¯æŒå¤šç§æŸ¥è¯¢æ¨¡å¼
CREATE TABLE users (
    user_id INT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100),
    age INT,
    created_at TIMESTAMP,
    
    -- B+æ ‘ç´¢å¼•æ”¯æŒèŒƒå›´æŸ¥è¯¢
    INDEX idx_age (age),
    INDEX idx_created_at (created_at),
    
    -- å¦‚æœæœ‰é«˜é¢‘ç²¾ç¡®æŸ¥è¯¢ï¼Œè€ƒè™‘Memoryä¸´æ—¶è¡¨
    -- CREATE TEMPORARY TABLE user_cache (
    --     user_id INT,
    --     username VARCHAR(50),
    --     INDEX hash_user_id (user_id) USING HASH
    -- ) ENGINE=Memory;
);

-- æŸ¥è¯¢ç­–ç•¥é€‰æ‹©
-- ç²¾ç¡®æŸ¥è¯¢ï¼šä¼˜å…ˆä½¿ç”¨Hashç´¢å¼•(å¦‚æœæœ‰)
SELECT * FROM users WHERE user_id = 12345;

-- èŒƒå›´æŸ¥è¯¢ï¼šå¿…é¡»ä½¿ç”¨B+æ ‘ç´¢å¼•
SELECT * FROM users WHERE age BETWEEN 25 AND 35;
SELECT * FROM users WHERE created_at > '2024-01-01' ORDER BY created_at;
```

---

## 8. ğŸš€ Hashç´¢å¼•ä¼˜åŒ–å®æˆ˜


### 8.1 å“ˆå¸Œç´¢å¼•é‡å»ºç­–ç•¥


**ğŸ”„ é‡å»ºè§¦å‘æ¡ä»¶**
```
æ€§èƒ½ä¸‹é™æŒ‡æ ‡ï¼š
â€¢ å¹³å‡æŸ¥æ‰¾æ¬¡æ•° > 2.0
â€¢ å†²çªç‡ > 30%
â€¢ å†…å­˜ä½¿ç”¨ç‡ > 85%
â€¢ æŸ¥è¯¢å“åº”æ—¶é—´æ˜æ˜¾å¢åŠ 

é‡å»ºç­–ç•¥ï¼š
â€¢ å®šæœŸé‡å»ºï¼šæ¯å¤©å‡Œæ™¨è‡ªåŠ¨é‡å»º
â€¢ é˜ˆå€¼è§¦å‘ï¼šè¾¾åˆ°æ€§èƒ½é˜ˆå€¼æ—¶é‡å»º
â€¢ ç‰ˆæœ¬æ§åˆ¶ï¼šæ–°æ—§ç‰ˆæœ¬åˆ‡æ¢ï¼Œé›¶åœæœºæ—¶é—´
```

**âš™ï¸ é‡å»ºå®ç°æ–¹æ¡ˆ**
```java
public class HashIndexRebuilder {
    
    public void scheduleRebuild() {
        // æ¯æ—¥å‡Œæ™¨2ç‚¹é‡å»º
        ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);
        
        scheduler.scheduleAtFixedRate(() -> {
            if (needsRebuild()) {
                performIncrementalRebuild();
            }
        }, 0, 24, TimeUnit.HOURS);
    }
    
    private boolean needsRebuild() {
        double avgLookupTime = measureAverageLookupTime();
        double conflictRate = calculateConflictRate();
        
        return avgLookupTime > 2.0 || conflictRate > 0.3;
    }
    
    private void performIncrementalRebuild() {
        // åˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨
        HashIndex newIndex = createNewHashIndex();
        
        // é€æ­¥è¿ç§»æ•°æ®
        migrateDataIncrementally(oldIndex, newIndex);
        
        // åŸå­åˆ‡æ¢
        atomicSwap(newIndex);
    }
}
```

### 8.2 ä¸€è‡´æ€§å“ˆå¸Œåº”ç”¨


**ğŸ”„ ä¸€è‡´æ€§å“ˆå¸ŒåŸç†**
```
ä¼ ç»Ÿå“ˆå¸Œé—®é¢˜ï¼š
â€¢ èŠ‚ç‚¹å¢å‡æ—¶éœ€è¦é‡æ–°å“ˆå¸Œå¤§é‡æ•°æ®
â€¢ æ•°æ®è¿ç§»æˆæœ¬å¾ˆé«˜

ä¸€è‡´æ€§å“ˆå¸Œè§£å†³æ–¹æ¡ˆï¼š
â€¢ å“ˆå¸Œç¯ï¼šå°†å“ˆå¸Œå€¼ç©ºé—´æƒ³è±¡æˆä¸€ä¸ªç¯
â€¢ èŠ‚ç‚¹æ˜ å°„ï¼šå°†æœåŠ¡å™¨èŠ‚ç‚¹æ˜ å°„åˆ°ç¯ä¸Š
â€¢ æ•°æ®å®šä½ï¼šæ•°æ®å­˜å‚¨åˆ°é¡ºæ—¶é’ˆæœ€è¿‘çš„èŠ‚ç‚¹
â€¢ èŠ‚ç‚¹å˜åŒ–ï¼šåªå½±å“ç›¸é‚»èŠ‚ç‚¹çš„æ•°æ®
```

**ğŸ¯ ä¸€è‡´æ€§å“ˆå¸Œç¯ç»“æ„**
```
             èŠ‚ç‚¹A (hash=100)
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    èŠ‚ç‚¹D â”‚               â”‚ èŠ‚ç‚¹B
  (hash=300)             (hash=150)
         â”‚      å“ˆå¸Œç¯      â”‚
         â”‚   0~4095      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
             èŠ‚ç‚¹C (hash=250)

æ•°æ®åˆ†å¸ƒï¼š
â€¢ hash(key) âˆˆ [0, 100] â†’ èŠ‚ç‚¹A
â€¢ hash(key) âˆˆ (100, 150] â†’ èŠ‚ç‚¹B  
â€¢ hash(key) âˆˆ (150, 250] â†’ èŠ‚ç‚¹C
â€¢ hash(key) âˆˆ (250, 300] â†’ èŠ‚ç‚¹D
â€¢ hash(key) âˆˆ (300, 4095] â†’ èŠ‚ç‚¹A
```

### 8.3 Hashç´¢å¼•å†…å­˜ç®¡ç†ä¼˜åŒ–


**ğŸ§  å†…å­˜ä¼˜åŒ–ç­–ç•¥**
```java
public class OptimizedHashIndex {
    
    // å†…å­˜æ± ç®¡ç†
    private ObjectPool<HashNode> nodePool = new ObjectPool<>(1000);
    
    // åˆ†å±‚Hashè¡¨ï¼šä¸åŒçƒ­åº¦çš„æ•°æ®ä½¿ç”¨ä¸åŒç­–ç•¥
    private HotDataHashTable hotIndex;    // çƒ­æ•°æ®ï¼šè½½è·å› å­0.5
    private ColdDataHashTable coldIndex;  // å†·æ•°æ®ï¼šè½½è·å› å­0.8
    
    public V get(K key) {
        // å…ˆæŸ¥çƒ­æ•°æ®åŒº
        V result = hotIndex.get(key);
        if (result != null) return result;
        
        // å†æŸ¥å†·æ•°æ®åŒº
        return coldIndex.get(key);
    }
    
    // è‡ªé€‚åº”çƒ­åº¦è°ƒæ•´
    private void adjustDataTemperature() {
        // ç»Ÿè®¡è®¿é—®é¢‘ç‡
        Map<K, Integer> accessCount = collectAccessStats();
        
        // çƒ­æ•°æ®è¿ç§»åˆ°çƒ­åŒº
        for (Map.Entry<K, Integer> entry : accessCount.entrySet()) {
            if (entry.getValue() > HOT_THRESHOLD) {
                promoteToHotIndex(entry.getKey());
            }
        }
    }
}
```

### 8.4 Hashç´¢å¼•å¹¶å‘æ€§èƒ½è°ƒä¼˜


**âš¡ å¹¶å‘ä¼˜åŒ–æŠ€æœ¯**
```
æ— é”Hashè¡¨å®ç°ï¼š
â€¢ CASæ“ä½œï¼šä½¿ç”¨åŸå­æ“ä½œé¿å…é”ç«äº‰
â€¢ åˆ†æ®µé”ï¼šå°†å“ˆå¸Œè¡¨åˆ†æˆå¤šä¸ªæ®µï¼Œæ¯æ®µç‹¬ç«‹åŠ é”
â€¢ è¯»å†™åˆ†ç¦»ï¼šè¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œä½¿ç”¨ä¹è§‚é”

å¹¶å‘æ€§èƒ½è°ƒä¼˜å‚æ•°ï¼š
â€¢ å¹¶å‘çº§åˆ«ï¼šåˆ†æ®µé”çš„æ®µæ•°é‡
â€¢ è½½è·å› å­ï¼šå½±å“å†²çªæ¦‚ç‡å’Œæ‰©å®¹é¢‘ç‡
â€¢ åˆå§‹å®¹é‡ï¼šé¿å…é¢‘ç¹æ‰©å®¹
```

**ğŸ“Š å¹¶å‘æ€§èƒ½æµ‹è¯•**
```java
public class ConcurrentPerformanceTest {
    
    public void testConcurrentThroughput() {
        int threadCount = 16;
        int operationsPerThread = 100_000;
        
        CountDownLatch startLatch = new CountDownLatch(1);
        CountDownLatch endLatch = new CountDownLatch(threadCount);
        
        for (int i = 0; i < threadCount; i++) {
            new Thread(() -> {
                try {
                    startLatch.await(); // ç­‰å¾…ç»Ÿä¸€å¼€å§‹
                    
                    for (int j = 0; j < operationsPerThread; j++) {
                        String key = "key" + (j % 10000);
                        if (j % 3 == 0) {
                            hashIndex.put(key, "value" + j); // 33%å†™æ“ä½œ
                        } else {
                            hashIndex.get(key); // 67%è¯»æ“ä½œ
                        }
                    }
                } finally {
                    endLatch.countDown();
                }
            }).start();
        }
        
        long startTime = System.currentTimeMillis();
        startLatch.countDown(); // å¼€å§‹æµ‹è¯•
        
        endLatch.await(); // ç­‰å¾…ç»“æŸ
        long duration = System.currentTimeMillis() - startTime;
        
        long totalOps = threadCount * operationsPerThread;
        System.out.printf("æ€»æ“ä½œæ•°: %d%n", totalOps);
        System.out.printf("æ€»è€—æ—¶: %d ms%n", duration);  
        System.out.printf("ååé‡: %.2f ops/sec%n", totalOps * 1000.0 / duration);
    }
}
```

### 8.5 Hashç´¢å¼•ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ å…³é”®æ€§èƒ½æŒ‡æ ‡**
```sql
-- Memoryå¼•æ“Hashç´¢å¼•çŠ¶æ€ç›‘æ§
SELECT 
    TABLE_NAME,
    ENGINE,
    TABLE_ROWS,
    AVG_ROW_LENGTH,
    DATA_LENGTH,
    INDEX_LENGTH
FROM information_schema.TABLES 
WHERE ENGINE = 'Memory';

-- æŸ¥çœ‹Hashç´¢å¼•å†²çªæƒ…å†µï¼ˆéœ€è¦è‡ªå®šä¹‰ç›‘æ§ï¼‰
-- ç›‘æ§æŒ‡æ ‡ï¼š
-- â€¢ å¹³å‡æŸ¥æ‰¾æ¬¡æ•°
-- â€¢ å†²çªé“¾é•¿åº¦åˆ†å¸ƒ  
-- â€¢ è½½è·å› å­
-- â€¢ æ‰©å®¹é¢‘ç‡
```

**ğŸ” æ€§èƒ½è°ƒä¼˜æ£€æŸ¥æ¸…å•**
```
Hashç´¢å¼•æ€§èƒ½æ£€æŸ¥ï¼š
- [ ] è½½è·å› å­æ˜¯å¦åˆç†ï¼ˆ0.5-0.75ï¼‰
- [ ] å†²çªé“¾é•¿åº¦æ˜¯å¦è¿‡é•¿ï¼ˆå¹³å‡<2ï¼‰
- [ ] å†…å­˜ä½¿ç”¨æ˜¯å¦é«˜æ•ˆ
- [ ] å“ˆå¸Œå‡½æ•°åˆ†å¸ƒæ˜¯å¦å‡åŒ€
- [ ] å¹¶å‘è®¿é—®æ˜¯å¦æœ‰çƒ­ç‚¹
- [ ] æ‰©å®¹ç­–ç•¥æ˜¯å¦åˆç†

ä¼˜åŒ–å»ºè®®ï¼š
âœ… é€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°
âœ… æ§åˆ¶è½½è·å› å­åœ¨åˆç†èŒƒå›´
âœ… ä½¿ç”¨åˆ†æ®µé”æé«˜å¹¶å‘æ€§èƒ½
âœ… å®šæœŸç›‘æ§å’Œé‡å»ºç´¢å¼•
âœ… ä¸ºçƒ­ç‚¹æ•°æ®è®¾è®¡ä¸“é—¨ç­–ç•¥
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Hashç´¢å¼•æœ¬è´¨ï¼šåŸºäºå“ˆå¸Œè¡¨çš„O(1)æŸ¥æ‰¾æ•°æ®ç»“æ„
ğŸ”¸ å†²çªå¤„ç†ï¼šé“¾åœ°å€æ³•å’Œå¼€æ”¾åœ°å€æ³•ä¸¤å¤§ç±»è§£å†³æ–¹æ¡ˆ
ğŸ”¸ æ€§èƒ½ç‰¹ç‚¹ï¼šç­‰å€¼æŸ¥è¯¢æå¿«ï¼ŒèŒƒå›´æŸ¥è¯¢ä¸æ”¯æŒ
ğŸ”¸ å†…å­˜ç®¡ç†ï¼šæ‰©å®¹æœºåˆ¶å’Œå†…å­˜ä¼˜åŒ–ç­–ç•¥
ğŸ”¸ åº”ç”¨åœºæ™¯ï¼šç²¾ç¡®åŒ¹é…ã€é«˜å¹¶å‘ã€å†…å­˜å­˜å‚¨åœºæ™¯
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆHashç´¢å¼•è¿™ä¹ˆå¿«**
```
ç›´æ¥å®šä½åŸç†ï¼š
â€¢ é€šè¿‡å“ˆå¸Œå‡½æ•°ç›´æ¥è®¡ç®—ä½ç½®
â€¢ æ— éœ€åƒB+æ ‘é‚£æ ·å±‚å±‚æŸ¥æ‰¾
â€¢ ç†æƒ³æƒ…å†µä¸‹åªéœ€è¦ä¸€æ¬¡å†…å­˜è®¿é—®

ç¼“å­˜å‹å¥½ç‰¹æ€§ï¼š
â€¢ æ•°æ®ç»“æ„ç®€å•ï¼Œå†…å­˜å¸ƒå±€ç´§å‡‘
â€¢ çƒ­ç‚¹æ•°æ®å®¹æ˜“ä¿æŒåœ¨CPUç¼“å­˜ä¸­
â€¢ å‡å°‘ç¼“å­˜å¤±æ•ˆæ¬¡æ•°

å¹¶å‘ä¼˜åŠ¿ï¼š
â€¢ ä¸åŒé”®å€¼è®¿é—®ä¸åŒæ§½ä½ï¼Œå†²çªå°‘
â€¢ å¯ä»¥ä½¿ç”¨ç»†ç²’åº¦é”ï¼Œæé«˜å¹¶å‘åº¦
â€¢ è¯»æ“ä½œä¹‹é—´å®Œå…¨æ— å†²çª
```

**ğŸ”¹ Hashç´¢å¼•çš„å±€é™æ€§æ ¹æº**
```
å“ˆå¸Œç‰¹æ€§å†³å®šï¼š
â€¢ å“ˆå¸Œå‡½æ•°ç ´åäº†æ•°æ®çš„é¡ºåºå…³ç³»
â€¢ ç›¸é‚»çš„å€¼å“ˆå¸Œååˆ†æ•£åœ¨å„ä¸ªä½ç½®
â€¢ æ— æ³•åˆ©ç”¨æ•°æ®çš„æ’åºç‰¹æ€§

è®¾è®¡æƒè¡¡ï¼š
â€¢ ä¸ºäº†è·å¾—O(1)æŸ¥æ‰¾æ€§èƒ½
â€¢ æ”¾å¼ƒäº†èŒƒå›´æŸ¥è¯¢å’Œæ’åºèƒ½åŠ›
â€¢ è¿™æ˜¯ç®—æ³•è®¾è®¡çš„å¿…ç„¶å–èˆ
```

**ğŸ”¹ ä»€ä¹ˆæ—¶å€™é€‰æ‹©Hashç´¢å¼•**
```
é€‰æ‹©Hashç´¢å¼•çš„æ¡ä»¶ï¼š
â€¢ æŸ¥è¯¢æ¨¡å¼ï¼š99%éƒ½æ˜¯ç²¾ç¡®åŒ¹é…
â€¢ æ•°æ®ç‰¹å¾ï¼šé”®å€¼åˆ†å¸ƒç›¸å¯¹å‡åŒ€
â€¢ æ€§èƒ½è¦æ±‚ï¼šå¯¹æŸ¥è¯¢å»¶è¿Ÿææ•æ„Ÿ
â€¢ å­˜å‚¨é€‰æ‹©ï¼šå¯ä»¥æ¥å—å†…å­˜å­˜å‚¨

é€‰æ‹©B+æ ‘ç´¢å¼•çš„æ¡ä»¶ï¼š
â€¢ éœ€è¦èŒƒå›´æŸ¥è¯¢æˆ–æ’åº
â€¢ éœ€è¦æŒä¹…åŒ–å­˜å‚¨
â€¢ æŸ¥è¯¢æ¨¡å¼å¤æ‚å¤šæ ·
â€¢ æ•°æ®é‡æŒç»­å¢é•¿
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ åº”ç”¨åœºæ™¯åŒ¹é…**
- **é«˜é¢‘ç¼“å­˜**ï¼šç”¨æˆ·sessionã€é…ç½®ä¿¡æ¯ã€ä¸´æ—¶è®¡ç®—ç»“æœ
- **å®æ—¶ç³»ç»Ÿ**ï¼šåœ¨çº¿ç”¨æˆ·çŠ¶æ€ã€æ¶ˆæ¯è·¯ç”±ã€è¿æ¥ç®¡ç†
- **è®¡ç®—åŠ é€Ÿ**ï¼šæŸ¥æ‰¾è¡¨ã€æ˜ å°„å…³ç³»ã€å»é‡å¤„ç†
- **å†…å­˜æ•°æ®åº“**ï¼šRedisçš„Hashç»“æ„å°±æ˜¯å…¸å‹åº”ç”¨

**ğŸ”§ å®æ–½å»ºè®®**
- **åœºæ™¯è¯„ä¼°**ï¼šå…ˆåˆ†ææŸ¥è¯¢æ¨¡å¼ï¼Œç¡®è®¤æ˜¯å¦é€‚åˆHashç´¢å¼•
- **åŸå‹æµ‹è¯•**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ€§èƒ½æ”¶ç›Š
- **ç›‘æ§éƒ¨ç½²**ï¼šä¸Šçº¿åæŒç»­ç›‘æ§å†²çªç‡å’Œæ€§èƒ½æŒ‡æ ‡
- **å¤‡é€‰æ–¹æ¡ˆ**ï¼šå‡†å¤‡B+æ ‘ç´¢å¼•ä½œä¸ºå¤‡é€‰ï¼Œä»¥é˜²éœ€æ±‚å˜åŒ–

### 9.4 æŠ€æœ¯å‘å±•è¶‹åŠ¿


**ğŸš€ Hashç´¢å¼•å‘å±•æ–¹å‘**
```
ç¡¬ä»¶ä¼˜åŒ–ï¼š
â€¢ SIMDæŒ‡ä»¤åŠ é€Ÿå“ˆå¸Œè®¡ç®—
â€¢ GPUå¹¶è¡Œå¤„ç†å¤§è§„æ¨¡Hashè¡¨
â€¢ NVME SSDæ”¯æŒçš„æŒä¹…åŒ–Hashç´¢å¼•

ç®—æ³•æ”¹è¿›ï¼š
â€¢ æ›´æ™ºèƒ½çš„å“ˆå¸Œå‡½æ•°è®¾è®¡
â€¢ è‡ªé€‚åº”å†²çªå¤„ç†ç­–ç•¥
â€¢ æœºå™¨å­¦ä¹ ä¼˜åŒ–çš„è´Ÿè½½å‡è¡¡

åˆ†å¸ƒå¼æ‰©å±•ï¼š
â€¢ åˆ†å¸ƒå¼ä¸€è‡´æ€§å“ˆå¸Œ
â€¢ è·¨èŠ‚ç‚¹çš„Hashç´¢å¼•åˆ†ç‰‡
â€¢ å¼¹æ€§æ‰©ç¼©å®¹æ”¯æŒ
```

**ğŸ“š å­¦ä¹ å»ºè®®**
- **ç†è®ºåŸºç¡€**ï¼šæ·±å…¥ç†è§£å“ˆå¸Œè¡¨æ•°æ®ç»“æ„åŸç†
- **å®è·µåŠ¨æ‰‹**ï¼šä½¿ç”¨Memoryå¼•æ“åˆ›å»ºHashç´¢å¼•æµ‹è¯•æ€§èƒ½
- **åœºæ™¯åˆ†æ**ï¼šåˆ†æä¸šåŠ¡æŸ¥è¯¢æ¨¡å¼ï¼Œåˆ¤æ–­é€‚ç”¨æ€§
- **æ€§èƒ½è°ƒä¼˜**ï¼šå­¦ä¼šç›‘æ§å’Œä¼˜åŒ–Hashç´¢å¼•æ€§èƒ½
- **æŠ€æœ¯è·Ÿè¸ª**ï¼šå…³æ³¨æ•°æ®åº“æ–°ç‰ˆæœ¬ä¸­Hashç´¢å¼•çš„æ”¹è¿›

**æ ¸å¿ƒè®°å¿†**ï¼š
- Hashç´¢å¼•ç­‰å€¼å¿«å¦‚é—ªç”µï¼ŒèŒƒå›´æŸ¥è¯¢æ— èƒ½ä¸ºåŠ›
- é“¾åœ°å€æ‹‰é“¾å¼€æ”¾åœ°å€ï¼Œå†²çªå¤„ç†å„æœ‰åƒç§‹  
- å†…å­˜å¼•æ“æ˜¯ä¸»æˆ˜åœºï¼Œå¹¶å‘æ€§èƒ½è¡¨ç°ä½³
- é€‚ç”¨åœºæ™¯è¦é€‰å¥½ï¼Œç›‘æ§è°ƒä¼˜ä¸å¯å°‘
- ä¸B+æ ‘å„æœ‰é•¿çŸ­ï¼Œç»„åˆä½¿ç”¨æ•ˆæœæ£’