---
title: 8ã€ç´¢å¼•é€‰æ‹©æ€§è®¡ç®—
---
## ğŸ“š ç›®å½•

1. [ç´¢å¼•é€‰æ‹©æ€§åŸºç¡€æ¦‚å¿µ](#1-ç´¢å¼•é€‰æ‹©æ€§åŸºç¡€æ¦‚å¿µ)
2. [åŸºæ•°ç»Ÿè®¡è®¡ç®—æ–¹æ³•](#2-åŸºæ•°ç»Ÿè®¡è®¡ç®—æ–¹æ³•)
3. [é€‰æ‹©æ€§é˜ˆå€¼åˆ¤æ–­æ ‡å‡†](#3-é€‰æ‹©æ€§é˜ˆå€¼åˆ¤æ–­æ ‡å‡†)
4. [ä½é€‰æ‹©æ€§ç´¢å¼•é—®é¢˜åˆ†æ](#4-ä½é€‰æ‹©æ€§ç´¢å¼•é—®é¢˜åˆ†æ)
5. [é€‰æ‹©æ€§é‡‡æ ·æ–¹æ³•è¯¦è§£](#5-é€‰æ‹©æ€§é‡‡æ ·æ–¹æ³•è¯¦è§£)
6. [å¤åˆç´¢å¼•é€‰æ‹©æ€§åˆ†æ](#6-å¤åˆç´¢å¼•é€‰æ‹©æ€§åˆ†æ)
7. [é€‰æ‹©æ€§è®¡ç®—ä¼˜åŒ–ç®—æ³•](#7-é€‰æ‹©æ€§è®¡ç®—ä¼˜åŒ–ç®—æ³•)
8. [åŠ¨æ€é€‰æ‹©æ€§ç›‘æ§ç³»ç»Ÿ](#8-åŠ¨æ€é€‰æ‹©æ€§ç›‘æ§ç³»ç»Ÿ)
9. [é€‰æ‹©æ€§é¢„æµ‹æ¨¡å‹æ„å»º](#9-é€‰æ‹©æ€§é¢„æµ‹æ¨¡å‹æ„å»º)
10. [å¤šç»´é€‰æ‹©æ€§åˆ†ææŠ€æœ¯](#10-å¤šç»´é€‰æ‹©æ€§åˆ†ææŠ€æœ¯)
11. [é€‰æ‹©æ€§å¼‚å¸¸æ£€æµ‹å‘Šè­¦](#11-é€‰æ‹©æ€§å¼‚å¸¸æ£€æµ‹å‘Šè­¦)
12. [é€‰æ‹©æ€§ä¼˜åŒ–å†³ç­–æ”¯æŒ](#12-é€‰æ‹©æ€§ä¼˜åŒ–å†³ç­–æ”¯æŒ)
13. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#13-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç´¢å¼•é€‰æ‹©æ€§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•é€‰æ‹©æ€§


**ğŸ”¸ é€šä¿—ç†è§£**
```
æƒ³è±¡ä½ åœ¨å›¾ä¹¦é¦†æ‰¾ä¹¦ï¼š

é«˜é€‰æ‹©æ€§ç´¢å¼• = è¯¦ç»†çš„å›¾ä¹¦ç›®å½•
â€¢ æ¯ä¸ªä¹¦åéƒ½èƒ½å¿«é€Ÿå®šä½åˆ°å…·ä½“ä½ç½®
â€¢ ç›®å½•ä¸­å¾ˆå°‘æœ‰é‡å¤é¡¹
â€¢ æŸ¥æ‰¾æ•ˆç‡å¾ˆé«˜

ä½é€‰æ‹©æ€§ç´¢å¼• = ç²—ç³™çš„åˆ†ç±»æ ‡ç­¾
â€¢ æ¯”å¦‚åªæŒ‰"æ–‡å­¦ç±»"ã€"ç§‘æŠ€ç±»"åˆ†ç±»
â€¢ æ¯ä¸ªåˆ†ç±»ä¸‹æœ‰æˆåƒä¸Šä¸‡æœ¬ä¹¦
â€¢ è¿˜æ˜¯è¦ç¿»æ‰¾å¾ˆä¹…æ‰èƒ½æ‰¾åˆ°æƒ³è¦çš„ä¹¦
```

**ğŸ“‹ æŠ€æœ¯å®šä¹‰**
```
ç´¢å¼•é€‰æ‹©æ€§(Index Selectivity)ï¼š
å®šä¹‰ï¼šç´¢å¼•ä¸­ä¸åŒå€¼çš„æ•°é‡ä¸æ€»è¡Œæ•°çš„æ¯”å€¼
å…¬å¼ï¼šé€‰æ‹©æ€§ = å”¯ä¸€å€¼æ•°é‡(åŸºæ•°) Ã· æ€»è¡Œæ•°
å–å€¼èŒƒå›´ï¼š0 åˆ° 1 ä¹‹é—´
â€¢ 1.0 = å®Œç¾é€‰æ‹©æ€§(å¦‚ä¸»é”®)
â€¢ 0.x = é€‰æ‹©æ€§è¶Šä½ï¼Œé‡å¤å€¼è¶Šå¤š
```

**ğŸ’¡ é€‰æ‹©æ€§çš„ç›´è§‚ç†è§£**
```
ä¾‹å­ï¼šç”¨æˆ·è¡¨æœ‰100ä¸‡æ¡è®°å½•

ç”¨æˆ·IDå­—æ®µï¼š
â€¢ 100ä¸‡ä¸ªä¸åŒçš„ç”¨æˆ·ID
â€¢ é€‰æ‹©æ€§ = 1,000,000 Ã· 1,000,000 = 1.0
â€¢ è§£é‡Šï¼šæ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œé€‰æ‹©æ€§å®Œç¾

æ€§åˆ«å­—æ®µï¼š
â€¢ åªæœ‰"ç”·"å’Œ"å¥³"ä¸¤ä¸ªå€¼
â€¢ é€‰æ‹©æ€§ = 2 Ã· 1,000,000 = 0.000002
â€¢ è§£é‡Šï¼šé‡å¤åº¦æé«˜ï¼Œé€‰æ‹©æ€§æå·®

é‚®ç®±å­—æ®µï¼š
â€¢ 950,000ä¸ªä¸åŒçš„é‚®ç®±ï¼ˆä¸€äº›ç”¨æˆ·å¯èƒ½é‡å¤ï¼‰
â€¢ é€‰æ‹©æ€§ = 950,000 Ã· 1,000,000 = 0.95
â€¢ è§£é‡Šï¼šé€‰æ‹©æ€§å¾ˆå¥½ï¼Œé€‚åˆå»ºç´¢å¼•
```

### 1.2 é€‰æ‹©æ€§ä¸æŸ¥è¯¢æ€§èƒ½çš„å…³ç³»


**âš¡ æ€§èƒ½å½±å“åŸç†**
```
é«˜é€‰æ‹©æ€§ç´¢å¼•æŸ¥è¯¢è¿‡ç¨‹ï¼š
ç”¨æˆ·æŸ¥è¯¢ï¼šWHERE user_id = 12345
ç´¢å¼•æ‰«æï¼šç›´æ¥å®šä½åˆ°1æ¡è®°å½•
æ•°æ®è¯»å–ï¼šåªè¯»å–1ä¸ªæ•°æ®é¡µ
æ€§èƒ½ï¼šæå¿«

ä½é€‰æ‹©æ€§ç´¢å¼•æŸ¥è¯¢è¿‡ç¨‹ï¼š
ç”¨æˆ·æŸ¥è¯¢ï¼šWHERE gender = 'ç”·'
ç´¢å¼•æ‰«æï¼šæ‰¾åˆ°50ä¸‡ä¸ªåŒ¹é…è®°å½•
æ•°æ®è¯»å–ï¼šå¯èƒ½éœ€è¦è¯»å–å‡ ä¸‡ä¸ªæ•°æ®é¡µ
æ€§èƒ½ï¼šå¾ˆæ…¢ï¼Œç”šè‡³æ¯”å…¨è¡¨æ‰«æè¿˜æ…¢
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹**
```
å‡è®¾ï¼šç”¨æˆ·è¡¨100ä¸‡è®°å½•ï¼Œæ¯é¡µå­˜å‚¨100æ¡è®°å½•

æŸ¥è¯¢æ–¹å¼å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æŸ¥è¯¢æ¡ä»¶       â”‚ åŒ¹é…è®°å½•æ•°   â”‚ éœ€è¯»å–é¡µæ•°   â”‚ ç›¸å¯¹æ€§èƒ½    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id = 123   â”‚      1      â”‚      1      â”‚  æœ€å¿« âš¡   â”‚
â”‚ email = 'xx'    â”‚      1      â”‚      1      â”‚  æœ€å¿« âš¡   â”‚
â”‚ age = 25        â”‚    50,000   â”‚    5,000    â”‚  è¾ƒæ…¢ ğŸŒ   â”‚
â”‚ gender = 'ç”·'   â”‚   500,000   â”‚   50,000    â”‚  å¾ˆæ…¢ ğŸŒğŸŒ â”‚
â”‚ status = 'æ´»è·ƒ' â”‚   800,000   â”‚   80,000    â”‚ ææ…¢ ğŸŒğŸŒğŸŒâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“è®ºï¼šé€‰æ‹©æ€§è¶Šé«˜ï¼ŒæŸ¥è¯¢è¶Šå¿«ï¼
```

### 1.3 é€‰æ‹©æ€§åœ¨ç´¢å¼•è®¾è®¡ä¸­çš„ä½œç”¨


**ğŸ¯ ç´¢å¼•è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™**
```
1. é«˜é€‰æ‹©æ€§å­—æ®µä¼˜å…ˆå»ºç´¢å¼•
   â€¢ ä¸»é”®ã€å”¯ä¸€é”®ï¼šå¤©ç„¶çš„é«˜é€‰æ‹©æ€§
   â€¢ é‚®ç®±ã€æ‰‹æœºå·ï¼šé€šå¸¸æœ‰å¾ˆå¥½çš„é€‰æ‹©æ€§
   
2. ä½é€‰æ‹©æ€§å­—æ®µè°¨æ…å»ºç´¢å¼•
   â€¢ æ€§åˆ«ã€çŠ¶æ€ï¼šå€¼åŸŸå°ï¼Œé‡å¤åº¦é«˜
   â€¢ åˆ†ç±»ã€çº§åˆ«ï¼šå¯èƒ½å¯¼è‡´ç´¢å¼•æ— æ•ˆ
   
3. å¤åˆç´¢å¼•çš„é€‰æ‹©æ€§è®¾è®¡
   â€¢ é«˜é€‰æ‹©æ€§å­—æ®µæ”¾åœ¨å‰é¢
   â€¢ ä½é€‰æ‹©æ€§å­—æ®µæ”¾åœ¨åé¢
   â€¢ æ•´ä½“é€‰æ‹©æ€§è¦è¶³å¤Ÿé«˜
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£ï¼š** ç´¢å¼•é€‰æ‹©æ€§æ˜¯è¡¡é‡ç´¢å¼•"æœ‰ç”¨ç¨‹åº¦"çš„å…³é”®æŒ‡æ ‡ï¼Œå°±åƒå›¾ä¹¦é¦†ç›®å½•çš„è¯¦ç»†ç¨‹åº¦å†³å®šäº†æ‰¾ä¹¦çš„æ•ˆç‡ã€‚

---

## 2. ğŸ”¢ åŸºæ•°ç»Ÿè®¡è®¡ç®—æ–¹æ³•


### 2.1 ä»€ä¹ˆæ˜¯åŸºæ•°ç»Ÿè®¡


**ğŸ”¸ åŸºæ•°çš„æ¦‚å¿µ**
```
åŸºæ•°(Cardinality)ï¼šæ•°æ®é›†ä¸­ä¸é‡å¤å€¼çš„æ•°é‡

ç”Ÿæ´»ä¾‹å­ï¼š
ä¸€ä¸ªç­çº§40ä¸ªå­¦ç”Ÿçš„å§“åï¼š
â€¢ å¦‚æœ40ä¸ªä¸åŒå§“å â†’ åŸºæ•° = 40
â€¢ å¦‚æœåªæœ‰20ä¸ªä¸åŒå§“å â†’ åŸºæ•° = 20
â€¢ å¦‚æœå¤§å®¶éƒ½å«"å¼ ä¸‰" â†’ åŸºæ•° = 1

æ•°æ®åº“ä¸­ï¼š
è¡¨total_rows = 1,000,000æ¡è®°å½•
å­—æ®µdistinct_values = 50,000ä¸ªä¸åŒå€¼
åŸºæ•° = 50,000
é€‰æ‹©æ€§ = 50,000 Ã· 1,000,000 = 0.05
```

### 2.2 ç²¾ç¡®åŸºæ•°è®¡ç®—æ–¹æ³•


**ğŸ” COUNT(DISTINCT) æ–¹æ³•**
```sql
-- è®¡ç®—æŸå­—æ®µçš„ç²¾ç¡®åŸºæ•°
SELECT 
    COUNT(*) as total_rows,                    -- æ€»è¡Œæ•°
    COUNT(DISTINCT email) as email_cardinality, -- é‚®ç®±åŸºæ•°
    COUNT(DISTINCT age) as age_cardinality,     -- å¹´é¾„åŸºæ•°
    COUNT(DISTINCT gender) as gender_cardinality -- æ€§åˆ«åŸºæ•°
FROM users;

-- è®¡ç®—é€‰æ‹©æ€§
SELECT 
    'email' as field_name,
    COUNT(DISTINCT email) as cardinality,
    COUNT(*) as total_rows,
    ROUND(COUNT(DISTINCT email) / COUNT(*), 4) as selectivity
FROM users

UNION ALL

SELECT 
    'age' as field_name,
    COUNT(DISTINCT age) as cardinality,
    COUNT(*) as total_rows,
    ROUND(COUNT(DISTINCT age) / COUNT(*), 4) as selectivity
FROM users;
```

**ğŸ“Š åŸºæ•°åˆ†å¸ƒåˆ†æ**
```sql
-- åˆ†æå­—æ®µå€¼çš„åˆ†å¸ƒæƒ…å†µ
SELECT 
    gender,
    COUNT(*) as count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM users), 2) as percentage
FROM users 
GROUP BY gender
ORDER BY count DESC;

-- ç»“æœç¤ºä¾‹ï¼š
-- gender | count   | percentage
-- ç”·      | 520,000 | 52.00
-- å¥³      | 480,000 | 48.00
-- 
-- åˆ†æï¼šæ€§åˆ«å­—æ®µåŸºæ•°=2ï¼Œåˆ†å¸ƒç›¸å¯¹å‡åŒ€ï¼Œä½†é€‰æ‹©æ€§æä½
```

### 2.3 è¿‘ä¼¼åŸºæ•°è®¡ç®—ç®—æ³•


**ğŸš€ ä¸ºä»€ä¹ˆéœ€è¦è¿‘ä¼¼ç®—æ³•**
```
ç²¾ç¡®è®¡ç®—çš„é—®é¢˜ï¼š
â€¢ å¤§è¡¨COUNT(DISTINCT)éå¸¸è€—æ—¶
â€¢ å¯èƒ½éœ€è¦å…¨è¡¨æ‰«æ
â€¢ é˜»å¡å…¶ä»–æŸ¥è¯¢
â€¢ èµ„æºæ¶ˆè€—å·¨å¤§

è¿‘ä¼¼ç®—æ³•çš„ä¼˜åŠ¿ï¼š
â€¢ è®¡ç®—é€Ÿåº¦å¿«ï¼Œç§’çº§å®Œæˆ
â€¢ å†…å­˜å ç”¨å°ï¼ŒMBçº§åˆ«
â€¢ ç²¾åº¦å¯æ§ï¼Œè¯¯å·®é€šå¸¸<5%
â€¢ é€‚åˆå®æ—¶ç›‘æ§åœºæ™¯
```

**ğŸ”§ HyperLogLogç®—æ³•å®ç°**
```java
public class HyperLogLogCardinality {
    private final HyperLogLog hll;
    
    public HyperLogLogCardinality() {
        this.hll = new HyperLogLog(14); // ç²¾åº¦å‚æ•°14ï¼Œè¯¯å·®çº¦1.6%
    }
    
    public void addValue(Object value) {
        if (value != null) {
            hll.offer(value);
        }
    }
    
    public long getCardinality() {
        return hll.cardinality();
    }
    
    // æ‰¹é‡è®¡ç®—è¡¨å­—æ®µçš„åŸºæ•°
    public Map<String, Long> calculateTableCardinality(String tableName, List<String> columns) {
        Map<String, HyperLogLog> columnHLLs = new HashMap<>();
        columns.forEach(col -> columnHLLs.put(col, new HyperLogLog(14)));
        
        String sql = "SELECT " + String.join(",", columns) + " FROM " + tableName;
        jdbcTemplate.query(sql, rs -> {
            columns.forEach(col -> {
                Object value = rs.getObject(col);
                columnHLLs.get(col).offer(value);
            });
        });
        
        return columns.stream().collect(Collectors.toMap(
            col -> col,
            col -> columnHLLs.get(col).cardinality()
        ));
    }
}
```

### 2.4 åŸºæ•°ç»Ÿè®¡çš„é‡‡æ ·ä¼˜åŒ–


**ğŸ“Š é‡‡æ ·ç­–ç•¥è®¾è®¡**
```java
public class SamplingCardinalityCalculator {
    
    public SelectivityInfo calculateWithSampling(String tableName, String columnName, 
                                               double sampleRate) {
        // MySQL 8.0+ æ”¯æŒTABLESAMPLE
        String sql = """
            SELECT 
                COUNT(*) as sample_total,
                COUNT(DISTINCT %s) as sample_cardinality
            FROM %s TABLESAMPLE SYSTEM(%f)
            """.formatted(columnName, tableName, sampleRate * 100);
        
        Map<String, Object> sampleResult = jdbcTemplate.queryForMap(sql);
        long sampleTotal = (Long) sampleResult.get("sample_total");
        long sampleCardinality = (Long) sampleResult.get("sample_cardinality");
        long totalRows = getTotalRowCount(tableName);
        
        // æ¨ç®—å…¨è¡¨åŸºæ•°
        long estimatedCardinality = Math.round(
            (double) sampleCardinality * totalRows / sampleTotal
        );
        
        return SelectivityInfo.builder()
            .cardinality(estimatedCardinality)
            .selectivity((double) estimatedCardinality / totalRows)
            .calculationMethod("SAMPLING")
            .accuracy(calculateAccuracy(sampleRate))
            .build();
    }
    
    private double calculateAccuracy(double sampleRate) {
        // é‡‡æ ·ç‡ä¸ç²¾åº¦çš„å…³ç³»ï¼ˆç»éªŒå…¬å¼ï¼‰
        return Math.min(0.95, 0.7 + sampleRate * 0.3);
    }
}
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£ï¼š** åŸºæ•°å°±æ˜¯"æœ‰å¤šå°‘ç§ä¸åŒçš„å€¼"ï¼Œé€‰æ‹©æ€§å°±æ˜¯"ä¸åŒå€¼çš„æ¯”ä¾‹"ã€‚å°±åƒç»Ÿè®¡ç­çº§é‡Œæœ‰å¤šå°‘ç§ä¸åŒçš„å§“æ°ä¸€æ ·ç®€å•ã€‚

---

## 3. âš–ï¸ é€‰æ‹©æ€§é˜ˆå€¼åˆ¤æ–­æ ‡å‡†


### 3.1 é€‰æ‹©æ€§åˆ†çº§æ ‡å‡†


**ğŸ“Š é€‰æ‹©æ€§è´¨é‡è¯„çº§**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                é€‰æ‹©æ€§è´¨é‡è¯„çº§è¡¨                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©æ€§èŒƒå›´  â”‚  è´¨é‡ç­‰çº§   â”‚   ç´¢å¼•ä»·å€¼   â”‚  å»ºè®®ç­–ç•¥  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0.9 - 1.0   â”‚ â­â­â­â­â­ â”‚ æé«˜       â”‚ å¼ºçƒˆæ¨è  â”‚
â”‚ 0.7 - 0.9   â”‚ â­â­â­â­   â”‚ å¾ˆé«˜       â”‚ æ¨èå»ºç«‹  â”‚
â”‚ 0.3 - 0.7   â”‚ â­â­â­     â”‚ ä¸­ç­‰       â”‚ æ ¹æ®éœ€è¦  â”‚
â”‚ 0.1 - 0.3   â”‚ â­â­       â”‚ è¾ƒä½       â”‚ è°¨æ…è€ƒè™‘  â”‚
â”‚ 0.0 - 0.1   â”‚ â­         â”‚ æä½       â”‚ ä¸å»ºè®®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ” å®é™…åœºæ™¯ä¸¾ä¾‹**
```
ç”µå•†ç³»ç»Ÿç”¨æˆ·è¡¨åˆ†æï¼š

å­—æ®µ          åŸºæ•°      æ€»è¡Œæ•°     é€‰æ‹©æ€§    è¯„çº§      å»ºè®®
user_id      1000000   1000000    1.00     â­â­â­â­â­  ä¸»é”®ç´¢å¼•
email         980000   1000000    0.98     â­â­â­â­â­  å”¯ä¸€ç´¢å¼•  
phone         950000   1000000    0.95     â­â­â­â­â­  å”¯ä¸€ç´¢å¼•
username      900000   1000000    0.90     â­â­â­â­â­  æ™®é€šç´¢å¼•
created_at     50000   1000000    0.05     â­â­      èŒƒå›´æŸ¥è¯¢å¯è€ƒè™‘
age              80   1000000    0.00008  â­        ä¸å»ºè®®
gender            2   1000000    0.000002 â­        ç»å¯¹ä¸å»ºè®®
status            5   1000000    0.000005 â­        ç»å¯¹ä¸å»ºè®®
```

### 3.2 é˜ˆå€¼åˆ¤æ–­å®ç°


**ğŸ› ï¸ è‡ªåŠ¨åŒ–é˜ˆå€¼åˆ¤æ–­**
```java
public class SelectivityThresholdJudge {
    private static final double EXCELLENT_THRESHOLD = 0.9;
    private static final double GOOD_THRESHOLD = 0.7;
    private static final double FAIR_THRESHOLD = 0.3;
    private static final double POOR_THRESHOLD = 0.1;
    
    public IndexRecommendation analyzeSelectivity(SelectivityInfo info) {
        double selectivity = info.getSelectivity();
        IndexRecommendation recommendation = new IndexRecommendation();
        
        if (selectivity >= EXCELLENT_THRESHOLD) {
            recommendation.setGrade("â­â­â­â­â­ ä¼˜ç§€");
            recommendation.setRecommendation("å¼ºçƒˆæ¨èå»ºç«‹ç´¢å¼•");
            recommendation.setPriority("é«˜ä¼˜å…ˆçº§");
        } else if (selectivity >= GOOD_THRESHOLD) {
            recommendation.setGrade("â­â­â­â­ è‰¯å¥½");
            recommendation.setRecommendation("æ¨èå»ºç«‹ç´¢å¼•");
            recommendation.setPriority("ä¸­ä¼˜å…ˆçº§");
        } else if (selectivity >= FAIR_THRESHOLD) {
            recommendation.setGrade("â­â­â­ ä¸€èˆ¬");
            recommendation.setRecommendation("ç»“åˆæŸ¥è¯¢é¢‘ç‡å†³å®š");
            recommendation.setPriority("ä½ä¼˜å…ˆçº§");
        } else if (selectivity >= POOR_THRESHOLD) {
            recommendation.setGrade("â­â­ è¾ƒå·®");
            recommendation.setRecommendation("ä¸å»ºè®®å•ç‹¬å»ºç´¢å¼•");
            recommendation.setPriority("ä¸æ¨è");
        } else {
            recommendation.setGrade("â­ æå·®");
            recommendation.setRecommendation("ç»å¯¹ä¸å»ºè®®å»ºç«‹ç´¢å¼•");
            recommendation.setPriority("ç¦æ­¢");
        }
        
        return recommendation;
    }
}
```

### 3.3 åŠ¨æ€é˜ˆå€¼è°ƒæ•´


**ğŸ“ˆ åŸºäºä¸šåŠ¡åœºæ™¯çš„é˜ˆå€¼è°ƒæ•´**
```java
public class AdaptiveThresholdManager {
    
    // æ ¹æ®è¡¨å¤§å°è°ƒæ•´é˜ˆå€¼
    public double getAdjustedThreshold(String quality, long totalRows) {
        double baseThreshold = getBaseThreshold(quality);
        
        if (totalRows > 10_000_000) {
            return baseThreshold * 0.8;  // å¤§è¡¨é™ä½20%è¦æ±‚
        } else if (totalRows < 100_000) {
            return baseThreshold * 1.2;  // å°è¡¨æé«˜20%è¦æ±‚
        }
        
        return baseThreshold;
    }
    
    // æ ¹æ®æŸ¥è¯¢æ¨¡å¼è°ƒæ•´é˜ˆå€¼
    public double adjustForQueryPattern(double baseThreshold, QueryPattern pattern) {
        switch (pattern) {
            case POINT_QUERY:  return baseThreshold;
            case RANGE_QUERY:  return baseThreshold * 0.7;
            case JOIN_QUERY:   return baseThreshold * 0.8;
            case GROUP_BY:     return baseThreshold * 0.6;
            default:           return baseThreshold;
        }
    }
}
```

---

## 4. âš ï¸ ä½é€‰æ‹©æ€§ç´¢å¼•é—®é¢˜åˆ†æ


### 4.1 ä½é€‰æ‹©æ€§ç´¢å¼•çš„å±å®³


**ğŸš¨ æ€§èƒ½é—®é¢˜åˆ†æ**
```
é—®é¢˜1ï¼šç´¢å¼•æ‰«ææ¯”å…¨è¡¨æ‰«ææ›´æ…¢

åŸç†è§£é‡Šï¼š
å‡è®¾æŸ¥è¯¢ï¼šSELECT * FROM users WHERE gender = 'ç”·'
è¡¨æ•°æ®ï¼š100ä¸‡ç”¨æˆ·ï¼Œ50ä¸‡ç”·æ€§ç”¨æˆ·

ä½¿ç”¨æ€§åˆ«ç´¢å¼•ï¼š
æ­¥éª¤1ï¼šæ‰«ææ€§åˆ«ç´¢å¼• â†’ æ‰¾åˆ°50ä¸‡ä¸ªè¡ŒæŒ‡é’ˆ
æ­¥éª¤2ï¼šæ ¹æ®è¡ŒæŒ‡é’ˆæŸ¥æ‰¾å®é™…æ•°æ® â†’ éšæœºIO 50ä¸‡æ¬¡
æ­¥éª¤3ï¼šæ•°æ®å¯èƒ½åˆ†å¸ƒåœ¨5ä¸‡ä¸ªä¸åŒçš„æ•°æ®é¡µä¸­
ç»“æœï¼šéœ€è¦è¯»å–5ä¸‡ä¸ªæ•°æ®é¡µ = å¤§é‡éšæœºIO

å…¨è¡¨æ‰«æï¼š
æ­¥éª¤1ï¼šé¡ºåºè¯»å–æ‰€æœ‰æ•°æ®é¡µ â†’ 1ä¸‡ä¸ªæ•°æ®é¡µ
æ­¥éª¤2ï¼šé€è¡Œæ£€æŸ¥æ€§åˆ«å­—æ®µ
ç»“æœï¼šé¡ºåºIOæ¯”éšæœºIOå¿«å¾—å¤š

ç»“è®ºï¼šç´¢å¼•åè€Œæ›´æ…¢ï¼
```

**ğŸ’° å­˜å‚¨ç©ºé—´æµªè´¹**
```sql
-- æŸ¥çœ‹ç´¢å¼•å¤§å°
SELECT 
    table_name,
    index_name,
    ROUND(stat_value * $$innodb_page_size / 1024 / 1024, 2) as size_mb
FROM mysql.innodb_index_stats 
WHERE stat_name = 'size' 
    AND table_name = 'users';

-- ç¤ºä¾‹ç»“æœï¼š
-- table_name | index_name  | size_mb
-- users      | PRIMARY     | 45.2    (ä¸»é”®ç´¢å¼•ï¼Œå¿…éœ€)
-- users      | idx_email   | 52.1    (é‚®ç®±ç´¢å¼•ï¼Œæœ‰ç”¨)
-- users      | idx_gender  | 15.8    (æ€§åˆ«ç´¢å¼•ï¼Œæµªè´¹!)

åˆ†æï¼šæ€§åˆ«ç´¢å¼•å ç”¨15.8MBç©ºé—´ï¼Œä½†æŸ¥è¯¢ä»·å€¼æä½
å»ºè®®ï¼šåˆ é™¤è¯¥ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨å’Œç»´æŠ¤æˆæœ¬
```

### 4.2 ä½é€‰æ‹©æ€§ç´¢å¼•è¯†åˆ«


**ğŸ” é—®é¢˜ç´¢å¼•è‡ªåŠ¨è¯†åˆ«**
```sql
-- è¯†åˆ«ä½é€‰æ‹©æ€§ç´¢å¼•çš„SQL
SELECT 
    t.table_name,
    t.column_name,
    s.cardinality,
    i.table_rows,
    ROUND(s.cardinality / i.table_rows, 4) as selectivity,
    CASE 
        WHEN s.cardinality / i.table_rows < 0.01 THEN 'ğŸ”´ æå·® - å»ºè®®åˆ é™¤'
        WHEN s.cardinality / i.table_rows < 0.1 THEN 'ğŸŸ¡ è¾ƒå·® - éœ€è¦è¯„ä¼°'
        ELSE 'ğŸŸ¢ æ­£å¸¸'
    END as recommendation
FROM information_schema.statistics s
JOIN information_schema.tables i ON s.table_name = i.table_name
JOIN information_schema.columns t ON s.table_name = t.table_name 
    AND s.column_name = t.column_name
WHERE s.table_schema = DATABASE()
    AND s.cardinality IS NOT NULL
    AND i.table_rows > 1000  -- åªåˆ†ææœ‰ä¸€å®šæ•°æ®é‡çš„è¡¨
ORDER BY selectivity ASC;
```

**ğŸ”§ è‡ªåŠ¨åŒ–è¯†åˆ«å·¥å…·**
```java
public class PoorIndexDetector {
    
    public List<IndexProblem> detectPoorIndexes(String schema) {
        String sql = """
            SELECT table_name, index_name, column_name, cardinality, table_rows,
                   ROUND(cardinality / table_rows, 6) as selectivity
            FROM information_schema.statistics s
            JOIN information_schema.tables t ON s.table_name = t.table_name
            WHERE s.table_schema = ? AND cardinality / table_rows < 0.1
            ORDER BY selectivity ASC
            """;
        
        return jdbcTemplate.query(sql, (rs, rowNum) -> {
            IndexProblem problem = new IndexProblem();
            problem.setTableName(rs.getString("table_name"));
            problem.setIndexName(rs.getString("index_name"));
            problem.setSelectivity(rs.getDouble("selectivity"));
            
            if (problem.getSelectivity() < 0.001) {
                problem.setProblemLevel("ğŸ”´ ä¸¥é‡");
                problem.setRecommendation("ç«‹å³åˆ é™¤è¯¥ç´¢å¼•");
            } else {
                problem.setProblemLevel("ğŸŸ¡ ä¸­ç­‰");
                problem.setRecommendation("è¯„ä¼°æŸ¥è¯¢éœ€æ±‚åè€ƒè™‘åˆ é™¤");
            }
            
            return problem;
        }, schema);
    }
}
```

---

## 5. ğŸ§® é€‰æ‹©æ€§é‡‡æ ·æ–¹æ³•è¯¦è§£


### 5.1 é‡‡æ ·æ–¹æ³•åˆ†ç±»


**ğŸ“Š é‡‡æ ·æ–¹æ³•å¯¹æ¯”åˆ†æ**

| é‡‡æ ·æ–¹æ³• | **åŸç†** | **ç²¾åº¦** | **é€Ÿåº¦** | **é€‚ç”¨åœºæ™¯** |
|----------|---------|---------|---------|-------------|
| **éšæœºé‡‡æ ·** | `RAND()éšæœºé€‰æ‹©è¡Œ` | â­â­â­ | â­â­â­â­ | æ•°æ®åˆ†å¸ƒå‡åŒ€ |
| **ç³»ç»Ÿé‡‡æ ·** | `æ¯Nè¡Œé€‰æ‹©1è¡Œ` | â­â­â­â­ | â­â­â­â­â­ | æ•°æ®æœ‰åºæ’åˆ— |
| **åˆ†å±‚é‡‡æ ·** | `æŒ‰å­ç¾¤æ¯”ä¾‹é‡‡æ ·` | â­â­â­â­â­ | â­â­â­ | æ•°æ®åˆ†å¸ƒä¸å‡ |
| **èšç°‡é‡‡æ ·** | `æŒ‰æ•°æ®é¡µé‡‡æ ·` | â­â­â­â­ | â­â­â­â­â­ | å¤§è¡¨å¿«é€Ÿä¼°ç®— |

### 5.2 æ™ºèƒ½é‡‡æ ·ç‡é€‰æ‹©


**âš™ï¸ è‡ªé€‚åº”é‡‡æ ·ç­–ç•¥**
```java
public class SmartSamplingStrategy {
    
    public double getOptimalSampleRate(long totalRows) {
        if (totalRows < 100_000) {
            return 1.0;  // å°è¡¨ç›´æ¥å…¨æ‰«æ
        } else if (totalRows < 1_000_000) {
            return 0.1;  // ä¸­ç­‰è¡¨10%é‡‡æ ·
        } else if (totalRows < 10_000_000) {
            return 0.01; // å¤§è¡¨1%é‡‡æ ·
        } else {
            return 0.001; // è¶…å¤§è¡¨0.1%é‡‡æ ·
        }
    }
    
    public SelectivityInfo calculateWithAdaptiveSampling(String tableName, String columnName) {
        long totalRows = getTotalRowCount(tableName);
        double sampleRate = getOptimalSampleRate(totalRows);
        SelectivityInfo result = calculateWithSampling(tableName, columnName, sampleRate);
        
        // å¦‚æœé‡‡æ ·ç»“æœç²¾åº¦ä¸å¤Ÿï¼Œå¢åŠ é‡‡æ ·ç‡é‡æ–°è®¡ç®—
        if (result.getAccuracy() < 0.9 && sampleRate < 0.1) {
            double newSampleRate = Math.min(0.1, sampleRate * 5);
            result = calculateWithSampling(tableName, columnName, newSampleRate);
        }
        
        return result;
    }
}
```

### 5.3 åˆ†å±‚é‡‡æ ·å®ç°


**ğŸ—ï¸ åˆ†å±‚é‡‡æ ·ç­–ç•¥**
```java
public class StratifiedSamplingCalculator {
    
    public SelectivityInfo calculateStratifiedSample(String tableName, String columnName) {
        List<DataStratum> strata = identifyDataStrata(tableName, columnName);
        Set<Object> totalDistinctValues = new HashSet<>();
        
        for (DataStratum stratum : strata) {
            String sql = """
                SELECT DISTINCT %s FROM %s WHERE %s ORDER BY RAND() LIMIT ?
                """.formatted(columnName, tableName, stratum.getCondition());
            
            List<Object> stratumValues = jdbcTemplate.queryForList(
                sql, Object.class, stratum.getSampleSize());
            totalDistinctValues.addAll(stratumValues);
        }
        
        long totalRows = getTotalRowCount(tableName);
        long estimatedCardinality = estimateCardinalityFromStrata(strata, totalDistinctValues.size());
        
        return SelectivityInfo.builder()
            .cardinality(estimatedCardinality)
            .selectivity((double) estimatedCardinality / totalRows)
            .calculationMethod("STRATIFIED_SAMPLING")
            .accuracy(0.92)
            .build();
    }
    
    private List<DataStratum> identifyDataStrata(String tableName, String columnName) {
        List<DataStratum> strata = new ArrayList<>();
        
        if (isTimeColumn(columnName)) {
            strata.add(new DataStratum("created_at >= DATE_SUB(NOW(), INTERVAL 1 MONTH)", 1000));
            strata.add(new DataStratum("created_at < DATE_SUB(NOW(), INTERVAL 1 MONTH)", 500));
        } else if (isNumericColumn(tableName, columnName)) {
            strata.add(new DataStratum(columnName + " BETWEEN 0 AND 1000", 800));
            strata.add(new DataStratum(columnName + " > 1000", 600));
        }
        
        return strata;
    }
}
```

---

## 6. ğŸ”— å¤åˆç´¢å¼•é€‰æ‹©æ€§åˆ†æ


### 6.1 å¤åˆç´¢å¼•é€‰æ‹©æ€§è®¡ç®—


**ğŸ”¸ å¤åˆç´¢å¼•çš„é€‰æ‹©æ€§åŸç†**
```
å•åˆ—ç´¢å¼•ï¼šåªè€ƒè™‘ä¸€ä¸ªå­—æ®µçš„åŒºåˆ†åº¦
å¤åˆç´¢å¼•ï¼šè€ƒè™‘å¤šä¸ªå­—æ®µç»„åˆçš„åŒºåˆ†åº¦

ç”Ÿæ´»ä¾‹å­ï¼š
å•åˆ—ç´¢å¼• = åªç”¨å§“æŸ¥æ‰¾äºº
â€¢ "å¼ "å§“å¯èƒ½æœ‰å¾ˆå¤šäººï¼ŒåŒºåˆ†åº¦ä½

å¤åˆç´¢å¼• = ç”¨"å§“+å"æŸ¥æ‰¾äºº  
â€¢ "å¼ ä¼Ÿ"çš„ç»„åˆåŒºåˆ†åº¦å°±é«˜å¾ˆå¤š

æ•°æ®åº“ä¾‹å­ï¼š
ç”¨æˆ·è¡¨æŸ¥è¯¢ï¼šWHERE city = 'åŒ—äº¬' AND age = 25
â€¢ cityå•åˆ—ï¼šé€‰æ‹©æ€§å¯èƒ½åªæœ‰0.01ï¼ˆå…¨å›½å‡ åä¸ªåŸå¸‚ï¼‰
â€¢ ageå•åˆ—ï¼šé€‰æ‹©æ€§å¯èƒ½åªæœ‰0.02ï¼ˆå¹´é¾„èŒƒå›´æœ‰é™ï¼‰
â€¢ city+ageç»„åˆï¼šé€‰æ‹©æ€§å¯èƒ½è¾¾åˆ°0.5ï¼ˆåŸå¸‚Ã—å¹´é¾„ç»„åˆï¼‰
```

**ğŸ“Š å¤åˆç´¢å¼•é€‰æ‹©æ€§è®¡ç®—å…¬å¼**
```sql
-- å¤åˆç´¢å¼•é€‰æ‹©æ€§è®¡ç®—
SELECT 
    COUNT(*) as total_rows,
    
    -- å•åˆ—é€‰æ‹©æ€§
    COUNT(DISTINCT city) as city_cardinality,
    COUNT(DISTINCT age) as age_cardinality,
    
    -- å¤åˆç´¢å¼•é€‰æ‹©æ€§
    COUNT(DISTINCT CONCAT(city, ':', age)) as city_age_cardinality,
    COUNT(DISTINCT CONCAT(city, ':', age, ':', gender)) as three_col_cardinality,
    
    -- è®¡ç®—é€‰æ‹©æ€§
    ROUND(COUNT(DISTINCT city) / COUNT(*), 4) as city_selectivity,
    ROUND(COUNT(DISTINCT CONCAT(city, ':', age)) / COUNT(*), 4) as city_age_selectivity

FROM users;
```

### 6.2 å¤åˆç´¢å¼•å­—æ®µé¡ºåºä¼˜åŒ–


**ğŸ”„ å­—æ®µé¡ºåºçš„å½±å“**
```java
public class CompositeIndexOrderOptimizer {
    
    public List<String> optimizeColumnOrder(String tableName, List<String> columns) {
        // è®¡ç®—æ¯åˆ—çš„é€‰æ‹©æ€§
        Map<String, Double> columnSelectivities = columns.stream()
            .collect(Collectors.toMap(
                col -> col,
                col -> calculateSelectivity(tableName, col).getSelectivity()
            ));
        
        // æŒ‰é€‰æ‹©æ€§ä»é«˜åˆ°ä½æ’åº
        return columns.stream()
            .sorted((col1, col2) -> Double.compare(
                columnSelectivities.get(col2),
                columnSelectivities.get(col1)
            ))
            .collect(Collectors.toList());
    }
    
    public void validateCompositeSelectivity(String tableName, List<String> columns) {
        for (int i = 1; i <= columns.size(); i++) {
            List<String> subColumns = columns.subList(0, i);
            double selectivity = calculateCompositeSelectivity(tableName, subColumns);
            
            log.info("ç´¢å¼• ({}) çš„é€‰æ‹©æ€§: {}", 
                String.join(",", subColumns), selectivity);
        }
    }
}
```

### 6.3 æœ€ä¼˜å¤åˆç´¢å¼•æŸ¥æ‰¾


**ğŸ” è‡ªåŠ¨åŒ–æœ€ä¼˜ç»„åˆåˆ†æ**
```java
public class OptimalCompositeIndexFinder {
    
    public CompositeIndexRecommendation findOptimalCombination(String tableName, 
                                                             List<String> candidateColumns) {
        List<CompositeOption> options = new ArrayList<>();
        
        // ç”Ÿæˆ2-4å­—æ®µçš„ç»„åˆ
        for (int size = 2; size <= Math.min(4, candidateColumns.size()); size++) {
            List<List<String>> combinations = generateCombinations(candidateColumns, size);
            
            for (List<String> combination : combinations) {
                List<String> optimalOrder = optimizeColumnOrder(tableName, combination);
                double selectivity = calculateCompositeSelectivity(tableName, optimalOrder);
                double indexValue = evaluateIndexValue(tableName, optimalOrder, selectivity);
                
                options.add(CompositeOption.builder()
                    .columns(optimalOrder)
                    .selectivity(selectivity)
                    .indexValue(indexValue)
                    .build());
            }
        }
        
        // è¿”å›æœ€ä¼˜æ–¹æ¡ˆ
        CompositeOption bestOption = options.stream()
            .max(Comparator.comparing(CompositeOption::getIndexValue))
            .orElse(null);
        
        return CompositeIndexRecommendation.builder()
            .recommendedColumns(bestOption.getColumns())
            .expectedSelectivity(bestOption.getSelectivity())
            .valueScore(bestOption.getIndexValue())
            .build();
    }
    
    private double evaluateIndexValue(String tableName, List<String> columns, double selectivity) {
        double selectivityScore = selectivity * 100;
        double usageScore = estimateQueryUsage(tableName, columns);
        double sizeScore = 100.0 / estimateIndexSize(tableName, columns);
        
        return selectivityScore * 0.5 + usageScore * 0.3 + sizeScore * 0.2;
    }
}
```

**ğŸ“Š ç»¼åˆå†³ç­–çŸ©é˜µ**
```
ç´¢å¼•å»ºç«‹å†³ç­–çŸ©é˜µï¼š

            æŸ¥è¯¢é¢‘ç‡
é€‰æ‹©æ€§      é«˜é¢‘    ä¸­é¢‘    ä½é¢‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ >0.9    â”‚ ğŸ’šå¼ºçƒˆâ”‚ ğŸ’šæ¨èâ”‚ ğŸŸ¡è€ƒè™‘â”‚
â”‚ 0.7-0.9 â”‚ ğŸ’šæ¨èâ”‚ ğŸŸ¡è€ƒè™‘â”‚ ğŸ”´ä¸å»ºè®®â”‚
â”‚ 0.3-0.7 â”‚ ğŸŸ¡è€ƒè™‘â”‚ ğŸ”´ä¸å»ºè®®â”‚ ğŸ”´ä¸å»ºè®®â”‚
â”‚ 0.1-0.3 â”‚ ğŸ”´ä¸å»ºè®®â”‚ ğŸ”´ä¸å»ºè®®â”‚ ğŸ”´ä¸å»ºè®®â”‚
â”‚ <0.1    â”‚ ğŸ”´ç¦æ­¢â”‚ ğŸ”´ç¦æ­¢â”‚ ğŸ”´ç¦æ­¢â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

ğŸ’š = å»ºè®®å»ºç«‹ç´¢å¼•
ğŸŸ¡ = éœ€è¦ç»¼åˆè¯„ä¼°
ğŸ”´ = ä¸å»ºè®®å»ºç«‹ç´¢å¼•
```

> **ğŸ’¡ å…³é”®ç†è§£ï¼š** å¤åˆç´¢å¼•çš„é€‰æ‹©æ€§é€šå¸¸æ¯”å•åˆ—ç´¢å¼•é«˜ï¼Œä½†è¦æ³¨æ„å­—æ®µé¡ºåºï¼Œé«˜é€‰æ‹©æ€§å­—æ®µæ”¾å‰é¢æ•ˆæœæœ€å¥½ã€‚

---

## 7. ğŸš€ é€‰æ‹©æ€§è®¡ç®—ä¼˜åŒ–ç®—æ³•


### 7.1 å¿«é€Ÿä¼°ç®—ç®—æ³•


**âš¡ åŸºäºç»Ÿè®¡ä¿¡æ¯çš„å¿«é€Ÿä¼°ç®—**
```java
public class FastSelectivityEstimator {
    
    public SelectivityInfo fastEstimate(String tableName, String columnName) {
        String sql = """
            SELECT t.table_rows, s.cardinality, c.data_type
            FROM information_schema.tables t
            JOIN information_schema.statistics s ON t.table_name = s.table_name
            JOIN information_schema.columns c ON t.table_name = c.table_name 
                AND s.column_name = c.column_name
            WHERE t.table_schema = DATABASE()
                AND t.table_name = ? AND s.column_name = ?
            """;
        
        try {
            Map<String, Object> result = jdbcTemplate.queryForMap(sql, tableName, columnName);
            
            long tableRows = (Long) result.get("table_rows");
            long cardinality = (Long) result.get("cardinality");
            String dataType = (String) result.get("data_type");
            
            // ä¿®æ­£ç»Ÿè®¡ä¿¡æ¯
            cardinality = correctCardinality(tableName, columnName, cardinality, dataType);
            double selectivity = tableRows > 0 ? (double) cardinality / tableRows : 0;
            
            return SelectivityInfo.builder()
                .cardinality(cardinality)
                .selectivity(selectivity)
                .calculationMethod("FAST_ESTIMATE")
                .build();
                
        } catch (EmptyResultDataAccessException e) {
            return fallbackSamplingCalculation(tableName, columnName);
        }
    }
}
```

### 7.2 å¢é‡è®¡ç®—ç®—æ³•


**ğŸ“ˆ åŸºäºå˜åŒ–çš„å¢é‡æ›´æ–°**
```java
public class IncrementalSelectivityCalculator {
    private final Map<String, SelectivitySnapshot> snapshots = new ConcurrentHashMap<>();
    
    public SelectivityInfo calculateIncremental(String tableName, String columnName) {
        String key = tableName + "." + columnName;
        SelectivitySnapshot lastSnapshot = snapshots.get(key);
        
        if (lastSnapshot == null) {
            return performFullCalculation(tableName, columnName);
        }
        
        DataChanges changes = getDataChangesSince(tableName, columnName, 
                                                lastSnapshot.getTimestamp());
        
        if (changes.getChangeRate() < 0.05) {  // å˜åŒ–å°äº5%
            return estimateWithMinimalChanges(lastSnapshot, changes);
        } else {
            return performSamplingCalculation(tableName, columnName);
        }
    }
    
    private SelectivityInfo estimateWithMinimalChanges(SelectivitySnapshot snapshot, 
                                                     DataChanges changes) {
        long oldCardinality = snapshot.getCardinality();
        long newUniqueValues = estimateNewUniqueValues(changes);
        long newCardinality = oldCardinality + newUniqueValues;
        long newTotalRows = snapshot.getTotalRows() + changes.getNetRowChange();
        
        return SelectivityInfo.builder()
            .cardinality(newCardinality)
            .selectivity((double) newCardinality / newTotalRows)
            .calculationMethod("INCREMENTAL_ESTIMATE")
            .build();
    }
}
```

### 7.3 å¹¶è¡Œè®¡ç®—ä¼˜åŒ–


**ğŸ”€ å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—**
```java
public class ParallelSelectivityCalculator {
    private final ExecutorService executorService = ForkJoinPool.commonPool();
    
    public Map<String, SelectivityInfo> calculateMultipleColumns(String tableName, 
                                                               List<String> columns) {
        List<CompletableFuture<Map.Entry<String, SelectivityInfo>>> futures = columns.stream()
            .map(column -> CompletableFuture.supplyAsync(() -> {
                SelectivityInfo info = calculateWithOptimization(tableName, column);
                return Map.entry(column, info);
            }, executorService))
            .collect(Collectors.toList());
        
        return futures.stream()
            .map(CompletableFuture::join)
            .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));
    }
    
    private SelectivityInfo calculateWithOptimization(String tableName, String columnName) {
        long startTime = System.currentTimeMillis();
        SelectivityAlgorithm algorithm = chooseOptimalAlgorithm(tableName, columnName);
        SelectivityInfo result = algorithm.calculate(tableName, columnName);
        
        long duration = System.currentTimeMillis() - startTime;
        result.setCalculationDuration(duration);
        
        return result;
    }
}
```

---

## 8. ğŸ“Š åŠ¨æ€é€‰æ‹©æ€§ç›‘æ§ç³»ç»Ÿ


### 8.1 å®æ—¶ç›‘æ§æ¶æ„è®¾è®¡


**ğŸ—ï¸ ç›‘æ§ç³»ç»Ÿæ¶æ„**
```
æ•°æ®åº“å˜åŒ– â†’ å˜åŒ–æ£€æµ‹å™¨ â†’ é€‰æ‹©æ€§è®¡ç®—å™¨ â†’ ç»“æœå­˜å‚¨ â†’ å‘Šè­¦ç³»ç»Ÿ
     â†“            â†“            â†“           â†“         â†“
  binlogç›‘å¬   å¢é‡è¯†åˆ«    å¿«é€Ÿç®—æ³•    å†å²è®°å½•   å¼‚å¸¸æ£€æµ‹
```

**ğŸ“Š ç›‘æ§æŒ‡æ ‡ä½“ç³»**
```java
public class SelectivityMonitoringSystem {
    
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ‰§è¡Œ
    public void monitorSelectivityChanges() {
        List<MonitoringTarget> targets = getMonitoringTargets();
        
        for (MonitoringTarget target : targets) {
            try {
                SelectivityInfo currentInfo = calculateCurrentSelectivity(
                    target.getTableName(), target.getColumnName());
                
                SelectivityInfo previousInfo = getLastSelectivityInfo(
                    target.getTableName(), target.getColumnName());
                
                // æ£€æµ‹æ˜¾è‘—å˜åŒ–
                if (hasSignificantChange(currentInfo, previousInfo)) {
                    handleSelectivityChange(target, currentInfo, previousInfo);
                }
                
                // ä¿å­˜å½“å‰çŠ¶æ€
                saveSelectivityInfo(currentInfo);
                
            } catch (Exception e) {
                log.error("ç›‘æ§é€‰æ‹©æ€§å¤±è´¥: {}.{}", target.getTableName(), 
                         target.getColumnName(), e);
            }
        }
    }
    
    private boolean hasSignificantChange(SelectivityInfo current, SelectivityInfo previous) {
        if (previous == null) return true;
        
        double changeRate = Math.abs(current.getSelectivity() - previous.getSelectivity()) 
                          / previous.getSelectivity();
        return changeRate > 0.1; // å˜åŒ–è¶…è¿‡10%è®¤ä¸ºæ˜¾è‘—
    }
}
```

### 8.2 é€‰æ‹©æ€§è¶‹åŠ¿åˆ†æ


**ğŸ“ˆ è¶‹åŠ¿åˆ†æå®ç°**
```java
public class SelectivityTrendAnalyzer {
    
    public SelectivityTrend analyzeSelectivityTrend(String tableName, String columnName, 
                                                  int days) {
        String sql = """
            SELECT 
                DATE(measured_at) as measure_date,
                AVG(selectivity) as avg_selectivity,
                MIN(selectivity) as min_selectivity,
                MAX(selectivity) as max_selectivity
            FROM selectivity_history
            WHERE table_name = ? AND column_name = ?
                AND measured_at >= DATE_SUB(NOW(), INTERVAL ? DAY)
            GROUP BY DATE(measured_at)
            ORDER BY measure_date
            """;
        
        List<SelectivityDataPoint> dataPoints = jdbcTemplate.query(sql, 
            (rs, rowNum) -> new SelectivityDataPoint(
                rs.getDate("measure_date").toLocalDate(),
                rs.getDouble("avg_selectivity"),
                rs.getDouble("min_selectivity"),
                rs.getDouble("max_selectivity")
            ), tableName, columnName, days);
        
        // è®¡ç®—è¶‹åŠ¿
        return SelectivityTrend.builder()
            .tableName(tableName)
            .columnName(columnName)
            .dataPoints(dataPoints)
            .trend(calculateTrendDirection(dataPoints))
            .volatility(calculateVolatility(dataPoints))
            .prediction(predictFutureSelectivity(dataPoints))
            .build();
    }
    
    private TrendDirection calculateTrendDirection(List<SelectivityDataPoint> points) {
        if (points.size() < 2) return TrendDirection.STABLE;
        
        double firstValue = points.get(0).getAvgSelectivity();
        double lastValue = points.get(points.size() - 1).getAvgSelectivity();
        double changeRate = (lastValue - firstValue) / firstValue;
        
        if (changeRate > 0.05) return TrendDirection.INCREASING;
        if (changeRate < -0.05) return TrendDirection.DECREASING;
        return TrendDirection.STABLE;
    }
}
```

### 8.3 è‡ªåŠ¨åŒ–ç›‘æ§é…ç½®


**âš™ï¸ ç›‘æ§ç›®æ ‡é…ç½®**
```sql
-- ç›‘æ§é…ç½®è¡¨
CREATE TABLE selectivity_monitoring_config (
    id INT AUTO_INCREMENT PRIMARY KEY,
    table_name VARCHAR(64) NOT NULL,
    column_name VARCHAR(64) NOT NULL,
    monitoring_enabled BOOLEAN DEFAULT TRUE,
    check_interval_minutes INT DEFAULT 60,
    change_threshold DECIMAL(4,3) DEFAULT 0.1,  -- å˜åŒ–é˜ˆå€¼10%
    alert_enabled BOOLEAN DEFAULT TRUE,
    last_check_time TIMESTAMP,
    
    UNIQUE KEY uk_table_column (table_name, column_name)
);

-- æ’å…¥é»˜è®¤ç›‘æ§é…ç½®
INSERT INTO selectivity_monitoring_config 
    (table_name, column_name, check_interval_minutes)
SELECT 
    table_name,
    column_name,
    CASE 
        WHEN table_rows > 10000000 THEN 30   -- å¤§è¡¨æ›´é¢‘ç¹ç›‘æ§
        WHEN table_rows > 1000000 THEN 60    -- ä¸­è¡¨æ ‡å‡†ç›‘æ§
        ELSE 120                             -- å°è¡¨é™ä½é¢‘ç‡
    END
FROM information_schema.statistics s
JOIN information_schema.tables t ON s.table_name = t.table_name
WHERE s.table_schema = DATABASE()
    AND s.cardinality / t.table_rows BETWEEN 0.01 AND 0.99  -- åªç›‘æ§ä¸­ç­‰é€‰æ‹©æ€§å­—æ®µ
    AND s.seq_in_index = 1;  -- åªç›‘æ§ç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µ
```

---

## 9. ğŸ”® é€‰æ‹©æ€§é¢„æµ‹æ¨¡å‹æ„å»º


### 9.1 é€‰æ‹©æ€§å˜åŒ–è¶‹åŠ¿é¢„æµ‹


**ğŸ”¸ é¢„æµ‹æ¨¡å‹çš„ä½œç”¨**
```
ä¸ºä»€ä¹ˆéœ€è¦é¢„æµ‹ï¼š
â€¢ æå‰å‘ç°é€‰æ‹©æ€§ä¸‹é™è¶‹åŠ¿
â€¢ é¢„è­¦ç´¢å¼•å¤±æ•ˆé£é™©
â€¢ æŒ‡å¯¼å®¹é‡è§„åˆ’å’Œç´¢å¼•è°ƒæ•´
â€¢ ä¼˜åŒ–ç´¢å¼•ç»´æŠ¤ç­–ç•¥

é¢„æµ‹çš„æ ¸å¿ƒæ€æƒ³ï¼š
åŸºäºå†å²æ•°æ®å˜åŒ–æ¨¡å¼ï¼Œé¢„æµ‹æœªæ¥é€‰æ‹©æ€§å˜åŒ–
```

**ğŸ“Š çº¿æ€§å›å½’é¢„æµ‹æ¨¡å‹**
```java
public class SelectivityPredictionModel {
    
    public SelectivityPrediction predictSelectivity(String tableName, String columnName, 
                                                  int predictDays) {
        // è·å–å†å²æ•°æ®
        List<SelectivityDataPoint> historicalData = getHistoricalSelectivity(
            tableName, columnName, 30); // 30å¤©å†å²æ•°æ®
        
        if (historicalData.size() < 7) {
            return SelectivityPrediction.builder()
                .confidence(0.0)
                .message("å†å²æ•°æ®ä¸è¶³ï¼Œæ— æ³•é¢„æµ‹")
                .build();
        }
        
        // ç®€å•çº¿æ€§å›å½’
        LinearRegressionModel model = buildLinearModel(historicalData);
        
        // é¢„æµ‹æœªæ¥å€¼
        double predictedSelectivity = model.predict(predictDays);
        double confidence = calculatePredictionConfidence(model, historicalData);
        
        return SelectivityPrediction.builder()
            .tableName(tableName)
            .columnName(columnName)
            .currentSelectivity(getCurrentSelectivity(tableName, columnName))
            .predictedSelectivity(predictedSelectivity)
            .predictionDays(predictDays)
            .confidence(confidence)
            .trend(determineTrend(model.getSlope()))
            .riskLevel(assessRiskLevel(predictedSelectivity))
            .build();
    }
    
    private LinearRegressionModel buildLinearModel(List<SelectivityDataPoint> data) {
        double[] x = new double[data.size()];
        double[] y = new double[data.size()];
        
        for (int i = 0; i < data.size(); i++) {
            x[i] = i;  // å¤©æ•°ä½œä¸ºxè½´
            y[i] = data.get(i).getAvgSelectivity();  // é€‰æ‹©æ€§ä½œä¸ºyè½´
        }
        
        return new LinearRegressionModel(x, y);
    }
}
```

### 9.2 é€‰æ‹©æ€§å˜åŒ–æ¨¡å¼åˆ†æ


**ğŸ” å˜åŒ–æ¨¡å¼è¯†åˆ«**
```java
public class SelectivityPatternAnalyzer {
    
    public ChangePattern analyzePattern(List<SelectivityDataPoint> data) {
        if (data.size() < 10) {
            return ChangePattern.INSUFFICIENT_DATA;
        }
        
        // è®¡ç®—å˜åŒ–ç‰¹å¾
        double variance = calculateVariance(data);
        double trend = calculateTrend(data);
        boolean hasCycles = detectCyclicPattern(data);
        boolean hasSeasonality = detectSeasonalPattern(data);
        
        // æ¨¡å¼åˆ†ç±»
        if (Math.abs(trend) < 0.01 && variance < 0.001) {
            return ChangePattern.STABLE;
        } else if (trend > 0.05) {
            return ChangePattern.INCREASING;
        } else if (trend < -0.05) {
            return ChangePattern.DECREASING;
        } else if (hasCycles) {
            return ChangePattern.CYCLIC;
        } else if (hasSeasonality) {
            return ChangePattern.SEASONAL;
        } else {
            return ChangePattern.RANDOM;
        }
    }
    
    private boolean detectCyclicPattern(List<SelectivityDataPoint> data) {
        // ç®€å•çš„å‘¨æœŸæ€§æ£€æµ‹ï¼šæ£€æŸ¥æ˜¯å¦æœ‰æ˜æ˜¾çš„é‡å¤æ¨¡å¼
        int period = 7; // å‡è®¾æŒ‰å‘¨æœŸå˜åŒ–
        if (data.size() < period * 3) return false;
        
        double correlation = calculateAutoCorrelation(data, period);
        return correlation > 0.7; // ç›¸å…³æ€§>70%è®¤ä¸ºæœ‰å‘¨æœŸæ€§
    }
}
```

### 9.3 é¢„æµ‹å‡†ç¡®æ€§è¯„ä¼°


**ğŸ¯ æ¨¡å‹å‡†ç¡®æ€§éªŒè¯**
```java
public class PredictionAccuracyEvaluator {
    
    public AccuracyMetrics evaluateModel(String tableName, String columnName) {
        // è·å–è¿‡å»30å¤©çš„å†å²æ•°æ®
        List<SelectivityDataPoint> allData = getHistoricalSelectivity(tableName, columnName, 30);
        
        if (allData.size() < 14) {
            return AccuracyMetrics.builder()
                .meanAbsoluteError(Double.NaN)
                .message("æ•°æ®ä¸è¶³ï¼Œæ— æ³•è¯„ä¼°å‡†ç¡®æ€§")
                .build();
        }
        
        // ä½¿ç”¨å‰20å¤©æ•°æ®è®­ç»ƒï¼Œå10å¤©æ•°æ®æµ‹è¯•
        List<SelectivityDataPoint> trainData = allData.subList(0, 20);
        List<SelectivityDataPoint> testData = allData.subList(20, allData.size());
        
        LinearRegressionModel model = buildLinearModel(trainData);
        
        // è®¡ç®—é¢„æµ‹è¯¯å·®
        double totalError = 0;
        for (int i = 0; i < testData.size(); i++) {
            double predicted = model.predict(20 + i);
            double actual = testData.get(i).getAvgSelectivity();
            totalError += Math.abs(predicted - actual);
        }
        
        double mae = totalError / testData.size(); // å¹³å‡ç»å¯¹è¯¯å·®
        
        return AccuracyMetrics.builder()
            .meanAbsoluteError(mae)
            .accuracy(1.0 - mae)  // å‡†ç¡®ç‡
            .confidence(calculateConfidence(mae))
            .build();
    }
}
```

---

## 10. ğŸ“Š å¤šç»´é€‰æ‹©æ€§åˆ†ææŠ€æœ¯


### 10.1 å¤šç»´åˆ†æçš„æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¤šç»´é€‰æ‹©æ€§åˆ†æ**
```
å•ç»´åˆ†æï¼šåªçœ‹ä¸€ä¸ªå­—æ®µçš„é€‰æ‹©æ€§
å¤šç»´åˆ†æï¼šåŒæ—¶è€ƒè™‘å¤šä¸ªç»´åº¦çš„é€‰æ‹©æ€§å…³ç³»

ç”Ÿæ´»ä¾‹å­ï¼š
å•ç»´ï¼šåªçœ‹"å¹´é¾„"æ¥åˆ†ç»„äººç¾¤ 
å¤šç»´ï¼šåŒæ—¶çœ‹"å¹´é¾„+æ”¶å…¥+åœ°åŒº"æ¥åˆ†ç»„äººç¾¤

æ•°æ®åº“åº”ç”¨ï¼š
å•ç»´ï¼šåˆ†æemailå­—æ®µçš„é€‰æ‹©æ€§
å¤šç»´ï¼šåˆ†æemailåœ¨ä¸åŒåœ°åŒºã€ä¸åŒæ—¶é—´æ®µçš„é€‰æ‹©æ€§åˆ†å¸ƒ
```

### 10.2 ç»´åº¦å…³è”åˆ†æ


**ğŸ”— å­—æ®µé—´ç›¸å…³æ€§åˆ†æ**
```java
public class MultiDimensionalSelectivityAnalyzer {
    
    public CorrelationMatrix analyzeColumnCorrelations(String tableName, List<String> columns) {
        CorrelationMatrix matrix = new CorrelationMatrix(columns.size());
        
        for (int i = 0; i < columns.size(); i++) {
            for (int j = i + 1; j < columns.size(); j++) {
                double correlation = calculateColumnCorrelation(tableName, 
                    columns.get(i), columns.get(j));
                matrix.set(i, j, correlation);
            }
        }
        
        return matrix;
    }
    
    private double calculateColumnCorrelation(String tableName, String col1, String col2) {
        String sql = """
            SELECT 
                COUNT(DISTINCT %s) as col1_cardinality,
                COUNT(DISTINCT %s) as col2_cardinality,
                COUNT(DISTINCT CONCAT(%s, ':', %s)) as combined_cardinality,
                COUNT(*) as total_rows
            FROM %s
            """.formatted(col1, col2, col1, col2, tableName);
        
        Map<String, Object> result = jdbcTemplate.queryForMap(sql);
        
        long card1 = (Long) result.get("col1_cardinality");
        long card2 = (Long) result.get("col2_cardinality");
        long combinedCard = (Long) result.get("combined_cardinality");
        
        // è®¡ç®—ç›¸å…³æ€§ï¼šå®Œå…¨ç‹¬ç«‹æ—¶ combined = card1 * card2
        double expectedCombined = (double) card1 * card2;
        return combinedCard / expectedCombined; // <1è¡¨ç¤ºæœ‰ç›¸å…³æ€§
    }
}
```

### 10.3 åˆ†åŒºé€‰æ‹©æ€§åˆ†æ


**ğŸ—‚ï¸ åˆ†åŒºç»´åº¦çš„é€‰æ‹©æ€§**
```sql
-- åˆ†æä¸åŒåˆ†åŒºçš„é€‰æ‹©æ€§å·®å¼‚
SELECT 
    PARTITION_NAME,
    TABLE_ROWS,
    -- æ¯ä¸ªåˆ†åŒºçš„é€‰æ‹©æ€§å¯èƒ½ä¸åŒ
    (SELECT COUNT(DISTINCT email) FROM users PARTITION(p0)) as p0_email_cardinality,
    (SELECT COUNT(DISTINCT email) FROM users PARTITION(p1)) as p1_email_cardinality,
    (SELECT COUNT(DISTINCT email) FROM users PARTITION(p2)) as p2_email_cardinality
FROM information_schema.PARTITIONS
WHERE TABLE_SCHEMA = DATABASE() 
    AND TABLE_NAME = 'users';
```

**ğŸ“Š æ—¶é—´ç»´åº¦é€‰æ‹©æ€§åˆ†æ**
```java
public class TemporalSelectivityAnalyzer {
    
    public Map<String, Double> analyzeSelectivityByTimeRange(String tableName, 
                                                           String columnName) {
        Map<String, Double> results = new HashMap<>();
        
        // åˆ†æä¸åŒæ—¶é—´æ®µçš„é€‰æ‹©æ€§
        String[] timeRanges = {
            "DATE_SUB(NOW(), INTERVAL 1 DAY)",
            "DATE_SUB(NOW(), INTERVAL 7 DAY)", 
            "DATE_SUB(NOW(), INTERVAL 30 DAY)",
            "DATE_SUB(NOW(), INTERVAL 365 DAY)"
        };
        
        String[] rangeNames = {"last_day", "last_week", "last_month", "last_year"};
        
        for (int i = 0; i < timeRanges.length; i++) {
            String sql = """
                SELECT 
                    COUNT(*) as total_rows,
                    COUNT(DISTINCT %s) as cardinality
                FROM %s 
                WHERE created_at >= %s
                """.formatted(columnName, tableName, timeRanges[i]);
            
            Map<String, Object> result = jdbcTemplate.queryForMap(sql);
            long totalRows = (Long) result.get("total_rows");
            long cardinality = (Long) result.get("cardinality");
            
            double selectivity = totalRows > 0 ? (double) cardinality / totalRows : 0;
            results.put(rangeNames[i], selectivity);
        }
        
        return results;
    }
}
```

### 10.4 å¤šç»´é€‰æ‹©æ€§å¯è§†åŒ–


**ğŸ“ˆ é€‰æ‹©æ€§çƒ­åŠ›å›¾æ•°æ®**
```java
public class SelectivityHeatmapGenerator {
    
    public SelectivityHeatmap generateHeatmap(String tableName, List<String> columns) {
        int size = columns.size();
        double[][] heatmapData = new double[size][size];
        
        // è®¡ç®—ä¸¤ä¸¤ç»„åˆçš„é€‰æ‹©æ€§
        for (int i = 0; i < size; i++) {
            for (int j = 0; j < size; j++) {
                if (i == j) {
                    // å¯¹è§’çº¿ï¼šå•åˆ—é€‰æ‹©æ€§
                    heatmapData[i][j] = calculateSingleSelectivity(tableName, columns.get(i));
                } else {
                    // éå¯¹è§’çº¿ï¼šå¤åˆé€‰æ‹©æ€§
                    heatmapData[i][j] = calculateCompositeSelectivity(tableName, 
                        Arrays.asList(columns.get(i), columns.get(j)));
                }
            }
        }
        
        return SelectivityHeatmap.builder()
            .columns(columns)
            .data(heatmapData)
            .maxSelectivity(Arrays.stream(heatmapData)
                .flatMapToDouble(Arrays::stream)
                .max().orElse(0.0))
            .minSelectivity(Arrays.stream(heatmapData)
                .flatMapToDouble(Arrays::stream)
                .min().orElse(0.0))
            .build();
    }
}
```

**ğŸ“Š é€‰æ‹©æ€§åˆ†å¸ƒå›¾ç¤º**
```
å­—æ®µç»„åˆé€‰æ‹©æ€§çƒ­åŠ›å›¾ï¼ˆç¤ºä¾‹ï¼‰ï¼š

        email  phone  username  age   city  gender
email   [0.98] 0.99   0.98     0.98  0.85  0.98
phone   0.99  [0.95]  0.96     0.95  0.82  0.95  
username 0.98  0.96  [0.90]    0.91  0.78  0.90
age     0.98  0.95   0.91    [0.08]  0.25  0.08
city    0.85  0.82   0.78     0.25  [0.03] 0.03
gender  0.98  0.95   0.90     0.08   0.03 [0.000002]

é¢œè‰²è¯´æ˜ï¼š
ğŸŸ¢ >0.7 é«˜é€‰æ‹©æ€§ï¼Œæ¨èç»„åˆ
ğŸŸ¡ 0.3-0.7 ä¸­ç­‰é€‰æ‹©æ€§ï¼Œè€ƒè™‘ç»„åˆ  
ğŸ”´ <0.3 ä½é€‰æ‹©æ€§ï¼Œä¸æ¨èç»„åˆ

è§‚å¯Ÿï¼šemail+ä»»ä½•å­—æ®µéƒ½æœ‰å¾ˆé«˜çš„å¤åˆé€‰æ‹©æ€§
      genderä¸ä»»ä½•å­—æ®µç»„åˆé€‰æ‹©æ€§éƒ½ä¸ä¼šæ˜¾è‘—æå‡
```

---

## 11. ğŸš¨ é€‰æ‹©æ€§å¼‚å¸¸æ£€æµ‹å‘Šè­¦


### 11.1 å¼‚å¸¸æ£€æµ‹ç®—æ³•


**ğŸ” é€‰æ‹©æ€§å¼‚å¸¸çš„ç±»å‹**
```
å¼‚å¸¸ç±»å‹1ï¼šé€‰æ‹©æ€§æ€¥å‰§ä¸‹é™
â€¢ åŸå› ï¼šå¤§é‡é‡å¤æ•°æ®å†™å…¥
â€¢ å½±å“ï¼šæŸ¥è¯¢æ€§èƒ½çªç„¶å˜å·®
â€¢ æ£€æµ‹ï¼šçŸ­æœŸå†…é€‰æ‹©æ€§ä¸‹é™>20%

å¼‚å¸¸ç±»å‹2ï¼šé€‰æ‹©æ€§å¼‚å¸¸æ³¢åŠ¨
â€¢ åŸå› ï¼šæ•°æ®åˆ é™¤æˆ–æ‰¹é‡æ›´æ–°
â€¢ å½±å“ï¼šæŸ¥è¯¢æ€§èƒ½ä¸ç¨³å®š  
â€¢ æ£€æµ‹ï¼šæ–¹å·®è¶…è¿‡æ­£å¸¸èŒƒå›´

å¼‚å¸¸ç±»å‹3ï¼šé€‰æ‹©æ€§å¤±çœŸ
â€¢ åŸå› ï¼šç»Ÿè®¡ä¿¡æ¯è¿‡æœŸ
â€¢ å½±å“ï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©é”™è¯¯ç´¢å¼•
â€¢ æ£€æµ‹ï¼šç»Ÿè®¡å€¼ä¸å®é™…å€¼å·®å¼‚>50%
```

**âš¡ å¼‚å¸¸æ£€æµ‹å®ç°**
```java
public class SelectivityAnomalyDetector {
    
    public List<SelectivityAnomaly> detectAnomalies() {
        List<SelectivityAnomaly> anomalies = new ArrayList<>();
        
        List<MonitoringTarget> targets = getActiveMonitoringTargets();
        
        for (MonitoringTarget target : targets) {
            // è·å–æœ€è¿‘çš„é€‰æ‹©æ€§æ•°æ®
            List<SelectivityDataPoint> recentData = getRecentSelectivity(
                target.getTableName(), target.getColumnName(), 7);
            
            if (recentData.size() < 3) continue;
            
            // æ£€æµ‹å„ç§å¼‚å¸¸
            detectDropAnomaly(target, recentData, anomalies);
            detectVolatilityAnomaly(target, recentData, anomalies);
            detectDistortionAnomaly(target, anomalies);
        }
        
        return anomalies;
    }
    
    private void detectDropAnomaly(MonitoringTarget target, 
                                  List<SelectivityDataPoint> data, 
                                  List<SelectivityAnomaly> anomalies) {
        double currentSelectivity = data.get(data.size() - 1).getAvgSelectivity();
        double previousSelectivity = data.get(0).getAvgSelectivity();
        double dropRate = (previousSelectivity - currentSelectivity) / previousSelectivity;
        
        if (dropRate > 0.2) {  // ä¸‹é™è¶…è¿‡20%
            anomalies.add(SelectivityAnomaly.builder()
                .type(AnomalyType.SIGNIFICANT_DROP)
                .tableName(target.getTableName())
                .columnName(target.getColumnName())
                .currentValue(currentSelectivity)
                .previousValue(previousSelectivity)
                .severity(dropRate > 0.5 ? Severity.CRITICAL : Severity.WARNING)
                .description(String.format("é€‰æ‹©æ€§ä¸‹é™%.1f%%", dropRate * 100))
                .build());
        }
    }
    
    private void detectVolatilityAnomaly(MonitoringTarget target, 
                                       List<SelectivityDataPoint> data,
                                       List<SelectivityAnomaly> anomalies) {
        double variance = calculateVariance(data);
        if (variance > 0.01) {  // æ–¹å·®è¿‡å¤§
            anomalies.add(SelectivityAnomaly.builder()
                .type(AnomalyType.HIGH_VOLATILITY)
                .tableName(target.getTableName())
                .columnName(target.getColumnName())
                .variance(variance)
                .description("é€‰æ‹©æ€§æ³¢åŠ¨å¼‚å¸¸")
                .build());
        }
    }
}
```

### 11.2 å‘Šè­¦ç­–ç•¥é…ç½®


**ğŸ”” åˆ†çº§å‘Šè­¦æœºåˆ¶**
```java
public class SelectivityAlertManager {
    
    public void processAnomalies(List<SelectivityAnomaly> anomalies) {
        for (SelectivityAnomaly anomaly : anomalies) {
            AlertMessage alert = createAlertMessage(anomaly);
            
            switch (anomaly.getSeverity()) {
                case CRITICAL:
                    sendCriticalAlert(alert);  // çŸ­ä¿¡+é‚®ä»¶+é’‰é’‰
                    break;
                case WARNING:
                    sendWarningAlert(alert);   // é‚®ä»¶+é’‰é’‰
                    break;
                case INFO:
                    sendInfoAlert(alert);      // é’‰é’‰æ¶ˆæ¯
                    break;
            }
        }
    }
    
    private AlertMessage createAlertMessage(SelectivityAnomaly anomaly) {
        return AlertMessage.builder()
            .title("ç´¢å¼•é€‰æ‹©æ€§å¼‚å¸¸å‘Šè­¦")
            .content(String.format("è¡¨: %s, å­—æ®µ: %s, é—®é¢˜: %s", 
                anomaly.getTableName(), anomaly.getColumnName(), anomaly.getDescription()))
            .severity(anomaly.getSeverity())
            .timestamp(Instant.now())
            .suggestedAction(generateSuggestedAction(anomaly))
            .build();
    }
}
```

**ğŸ“Š å‘Šè­¦é…ç½®è¡¨**
```sql
-- å‘Šè­¦è§„åˆ™é…ç½®è¡¨
CREATE TABLE selectivity_alert_rules (
    id INT AUTO_INCREMENT PRIMARY KEY,
    table_pattern VARCHAR(100),     -- è¡¨ååŒ¹é…æ¨¡å¼
    column_pattern VARCHAR(100),    -- å­—æ®µååŒ¹é…æ¨¡å¼
    anomaly_type VARCHAR(50),       -- å¼‚å¸¸ç±»å‹
    threshold_value DECIMAL(8,4),   -- é˜ˆå€¼
    alert_level ENUM('INFO','WARNING','CRITICAL'),
    enabled BOOLEAN DEFAULT TRUE,
    
    INDEX idx_patterns (table_pattern, column_pattern)
);

-- é»˜è®¤å‘Šè­¦è§„åˆ™
INSERT INTO selectivity_alert_rules VALUES 
(1, 'users', '%', 'SIGNIFICANT_DROP', 0.2, 'WARNING', TRUE),
(2, 'orders', '%', 'SIGNIFICANT_DROP', 0.15, 'CRITICAL', TRUE),
(3, '%', 'email', 'HIGH_VOLATILITY', 0.05, 'WARNING', TRUE);
```

---

## 12. ğŸ¯ é€‰æ‹©æ€§ä¼˜åŒ–å†³ç­–æ”¯æŒç³»ç»Ÿ


### 12.1 æ™ºèƒ½ç´¢å¼•å»ºè®®ç³»ç»Ÿ


**ğŸ¤– è‡ªåŠ¨åŒ–ç´¢å¼•å»ºè®®**
```java
public class IndexRecommendationEngine {
    
    public List<IndexRecommendation> generateRecommendations(String tableName) {
        List<IndexRecommendation> recommendations = new ArrayList<>();
        
        // åˆ†ææ‰€æœ‰å­—æ®µçš„é€‰æ‹©æ€§
        List<String> columns = getTableColumns(tableName);
        Map<String, SelectivityInfo> selectivities = calculateAllSelectivities(tableName, columns);
        
        // åˆ†ææŸ¥è¯¢æ¨¡å¼
        QueryPatternAnalysis queryAnalysis = analyzeQueryPatterns(tableName);
        
        for (String column : columns) {
            SelectivityInfo info = selectivities.get(column);
            QueryUsage usage = queryAnalysis.getColumnUsage(column);
            
            IndexRecommendation rec = generateSingleColumnRecommendation(info, usage);
            if (rec.isWorthCreating()) {
                recommendations.add(rec);
            }
        }
        
        // ç”Ÿæˆå¤åˆç´¢å¼•å»ºè®®
        recommendations.addAll(generateCompositeRecommendations(tableName, selectivities, queryAnalysis));
        
        return recommendations.stream()
            .sorted(Comparator.comparing(IndexRecommendation::getPriority).reversed())
            .collect(Collectors.toList());
    }
    
    private IndexRecommendation generateSingleColumnRecommendation(SelectivityInfo info, 
                                                                 QueryUsage usage) {
        double score = calculateIndexScore(info.getSelectivity(), usage.getFrequency());
        
        return IndexRecommendation.builder()
            .columnName(info.getColumnName())
            .selectivity(info.getSelectivity())
            .estimatedBenefit(score)
            .recommendation(score > 70 ? "å¼ºçƒˆæ¨è" : score > 40 ? "æ¨è" : "ä¸æ¨è")
            .build();
    }
}
```

### 12.2 æˆæœ¬æ•ˆç›Šåˆ†æ


**ğŸ’° ç´¢å¼•æˆæœ¬æ•ˆç›Šè¯„ä¼°**
```java
public class IndexCostBenefitAnalyzer {
    
    public CostBenefitAnalysis analyze(String tableName, List<String> proposedColumns) {
        // è®¡ç®—ç´¢å¼•æˆæœ¬
        IndexCost cost = calculateIndexCost(tableName, proposedColumns);
        
        // è®¡ç®—ç´¢å¼•æ”¶ç›Š  
        IndexBenefit benefit = calculateIndexBenefit(tableName, proposedColumns);
        
        // ç»¼åˆåˆ†æ
        double roiScore = benefit.getTotalBenefit() / cost.getTotalCost();
        
        return CostBenefitAnalysis.builder()
            .proposedIndex(String.join(",", proposedColumns))
            .cost(cost)
            .benefit(benefit)
            .roiScore(roiScore)
            .recommendation(generateRecommendation(roiScore))
            .build();
    }
    
    private IndexCost calculateIndexCost(String tableName, List<String> columns) {
        long tableRows = getTableRowCount(tableName);
        double estimatedSizeMB = estimateIndexSize(tableName, columns);
        
        return IndexCost.builder()
            .storageCostMB(estimatedSizeMB)
            .maintenanceCost(estimatedSizeMB * 0.1)  // ç»´æŠ¤æˆæœ¬çº¦ä¸ºå­˜å‚¨çš„10%
            .insertOverhead(columns.size() * 0.02)   // æ¯ä¸ªå­—æ®µå¢åŠ 2%æ’å…¥å¼€é”€
            .updateOverhead(columns.size() * 0.03)   // æ¯ä¸ªå­—æ®µå¢åŠ 3%æ›´æ–°å¼€é”€
            .build();
    }
    
    private IndexBenefit calculateIndexBenefit(String tableName, List<String> columns) {
        // åˆ†æè¯¥ç´¢å¼•èƒ½ä¼˜åŒ–çš„æŸ¥è¯¢
        List<QueryPattern> optimizableQueries = findOptimizableQueries(tableName, columns);
        
        double totalBenefit = optimizableQueries.stream()
            .mapToDouble(query -> query.getFrequency() * query.getExpectedSpeedup())
            .sum();
        
        return IndexBenefit.builder()
            .querySpeedup(totalBenefit)
            .optimizableQueries(optimizableQueries.size())
            .totalBenefit(totalBenefit)
            .build();
    }
}
```

### 12.3 ç´¢å¼•ç»´æŠ¤å»ºè®®


**ğŸ”§ ç´¢å¼•ç»´æŠ¤ç­–ç•¥**
```java
public class IndexMaintenanceAdvisor {
    
    public MaintenanceAdvice generateMaintenanceAdvice(String tableName) {
        List<IndexHealth> indexHealthList = analyzeAllIndexes(tableName);
        MaintenanceAdvice advice = new MaintenanceAdvice();
        
        for (IndexHealth health : indexHealthList) {
            if (health.getSelectivity() < 0.1 && health.getUsageCount() < 100) {
                advice.addAction(MaintenanceAction.builder()
                    .type("åˆ é™¤ç´¢å¼•")
                    .indexName(health.getIndexName())
                    .reason("é€‰æ‹©æ€§è¿‡ä½ä¸”ä½¿ç”¨é¢‘ç‡ä½")
                    .priority("é«˜")
                    .estimatedBenefit("èŠ‚çœ" + health.getSizeMB() + "MBå­˜å‚¨ç©ºé—´")
                    .build());
            }
            
            if (health.getSelectivity() > 0.8 && health.getUsageCount() > 10000) {
                advice.addAction(MaintenanceAction.builder()
                    .type("ä¿æŒç´¢å¼•")
                    .indexName(health.getIndexName())
                    .reason("é€‰æ‹©æ€§é«˜ä¸”ä½¿ç”¨é¢‘ç¹")
                    .priority("ä¿æŒ")
                    .build());
            }
            
            if (health.getFragmentation() > 30) {
                advice.addAction(MaintenanceAction.builder()
                    .type("é‡å»ºç´¢å¼•")
                    .indexName(health.getIndexName())
                    .reason("ç¢ç‰‡ç‡è¿‡é«˜")
                    .priority("ä¸­")
                    .build());
            }
        }
        
        return advice;
    }
}
```

### 12.4 å†³ç­–æ”¯æŒæŠ¥å‘Šç”Ÿæˆ


**ğŸ“‹ ç»¼åˆåˆ†ææŠ¥å‘Š**
```java
public class SelectivityReportGenerator {
    
    public SelectivityReport generateReport(String tableName) {
        SelectivityReport report = new SelectivityReport();
        report.setTableName(tableName);
        report.setGenerateTime(Instant.now());
        
        // åŸºç¡€ç»Ÿè®¡
        TableStats tableStats = getTableStats(tableName);
        report.setTableStats(tableStats);
        
        // å­—æ®µé€‰æ‹©æ€§åˆ†æ
        Map<String, SelectivityInfo> fieldAnalysis = analyzeAllFields(tableName);
        report.setFieldAnalysis(fieldAnalysis);
        
        // ç´¢å¼•ä½¿ç”¨åˆ†æ
        List<IndexUsageStats> indexUsage = analyzeIndexUsage(tableName);
        report.setIndexUsage(indexUsage);
        
        // ä¼˜åŒ–å»ºè®®
        List<OptimizationSuggestion> suggestions = generateOptimizationSuggestions(
            fieldAnalysis, indexUsage);
        report.setSuggestions(suggestions);
        
        return report;
    }
    
    private List<OptimizationSuggestion> generateOptimizationSuggestions(
            Map<String, SelectivityInfo> fieldAnalysis, 
            List<IndexUsageStats> indexUsage) {
        
        List<OptimizationSuggestion> suggestions = new ArrayList<>();
        
        // åˆ†æä½æ•ˆç´¢å¼•
        indexUsage.stream()
            .filter(idx -> idx.getSelectivity() < 0.1 && idx.getUsageCount() < 1000)
            .forEach(idx -> suggestions.add(OptimizationSuggestion.builder()
                .type("åˆ é™¤ç´¢å¼•")
                .target(idx.getIndexName())
                .reason("é€‰æ‹©æ€§ä½ä¸”ä½¿ç”¨å°‘")
                .expectedBenefit("èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œæå‡å†™å…¥æ€§èƒ½")
                .priority(3)
                .build()));
        
        // åˆ†æç¼ºå¤±ç´¢å¼•
        fieldAnalysis.values().stream()
            .filter(field -> field.getSelectivity() > 0.7)
            .filter(field -> !hasExistingIndex(field.getColumnName()))
            .forEach(field -> suggestions.add(OptimizationSuggestion.builder()
                .type("åˆ›å»ºç´¢å¼•") 
                .target(field.getColumnName())
                .reason("é€‰æ‹©æ€§é«˜ä½†æ²¡æœ‰ç´¢å¼•")
                .expectedBenefit("æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½")
                .priority(1)
                .build()));
        
        return suggestions;
    }
}
```

---

## 13. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 13.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç´¢å¼•é€‰æ‹©æ€§ï¼šè¡¡é‡ç´¢å¼•åŒºåˆ†åº¦çš„å…³é”®æŒ‡æ ‡ï¼Œå†³å®šç´¢å¼•æœ‰æ•ˆæ€§
ğŸ”¸ åŸºæ•°ç»Ÿè®¡ï¼šè®¡ç®—å­—æ®µä¸­ä¸é‡å¤å€¼æ•°é‡çš„å„ç§æ–¹æ³•å’Œç®—æ³•
ğŸ”¸ é˜ˆå€¼åˆ¤æ–­ï¼šæ ¹æ®é€‰æ‹©æ€§æ•°å€¼åˆ¤æ–­æ˜¯å¦é€‚åˆå»ºç«‹ç´¢å¼•
ğŸ”¸ ä½é€‰æ‹©æ€§é—®é¢˜ï¼šç†è§£ä½é€‰æ‹©æ€§ç´¢å¼•çš„å±å®³å’Œè¯†åˆ«æ–¹æ³•
ğŸ”¸ é‡‡æ ·æ–¹æ³•ï¼šåœ¨å¤§æ•°æ®åœºæ™¯ä¸‹å¿«é€Ÿä¼°ç®—é€‰æ‹©æ€§çš„æŠ€æœ¯
ğŸ”¸ å¤åˆç´¢å¼•é€‰æ‹©æ€§ï¼šå¤šå­—æ®µç»„åˆç´¢å¼•çš„é€‰æ‹©æ€§åˆ†æå’Œä¼˜åŒ–
ğŸ”¸ è®¡ç®—ä¼˜åŒ–ç®—æ³•ï¼šæé«˜é€‰æ‹©æ€§è®¡ç®—æ•ˆç‡çš„å„ç§ç®—æ³•
ğŸ”¸ åŠ¨æ€ç›‘æ§ï¼šå®æ—¶è·Ÿè¸ªé€‰æ‹©æ€§å˜åŒ–çš„ç›‘æ§ç³»ç»Ÿ
ğŸ”¸ é¢„æµ‹æ¨¡å‹ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹é€‰æ‹©æ€§å˜åŒ–è¶‹åŠ¿
ğŸ”¸ å¤šç»´åˆ†æï¼šä»å¤šä¸ªç»´åº¦ç»¼åˆåˆ†æé€‰æ‹©æ€§ç‰¹å¾
ğŸ”¸ å¼‚å¸¸æ£€æµ‹ï¼šè‡ªåŠ¨å‘ç°é€‰æ‹©æ€§å¼‚å¸¸å¹¶åŠæ—¶å‘Šè­¦
ğŸ”¸ å†³ç­–æ”¯æŒï¼šåŸºäºé€‰æ‹©æ€§åˆ†ææä¾›ç´¢å¼•ä¼˜åŒ–å»ºè®®
```

### 13.2 é€‰æ‹©æ€§è®¡ç®—æ–¹æ³•å¯¹æ¯”


**ğŸ“Š è®¡ç®—æ–¹æ³•é€‰æ‹©æŒ‡å—**

| æ•°æ®è§„æ¨¡ | **æ¨èæ–¹æ³•** | **è®¡ç®—æ—¶é—´** | **ç²¾åº¦** | **é€‚ç”¨åœºæ™¯** |
|----------|-------------|-------------|---------|-------------|
| **< 10ä¸‡è¡Œ** | `ç²¾ç¡®è®¡ç®—COUNT(DISTINCT)` | ç§’çº§ | 100% | å°è¡¨å®æ—¶è®¡ç®— |
| **10ä¸‡-100ä¸‡** | `10%éšæœºé‡‡æ ·` | ç§’çº§ | 95%+ | ä¸­è¡¨å¿«é€Ÿä¼°ç®— |
| **100ä¸‡-1000ä¸‡** | `1%ç³»ç»Ÿé‡‡æ ·` | åˆ†é’Ÿçº§ | 90%+ | å¤§è¡¨å®šæœŸè®¡ç®— |
| **> 1000ä¸‡è¡Œ** | `HyperLogLogç®—æ³•` | ç§’çº§ | 95%+ | è¶…å¤§è¡¨å®æ—¶ç›‘æ§ |

### 13.3 é€‰æ‹©æ€§ä¼˜åŒ–å†³ç­–æ ‘


**ğŸŒ³ å†³ç­–æµç¨‹å›¾**
```
å¼€å§‹åˆ†æå­—æ®µé€‰æ‹©æ€§
         â†“
   è®¡ç®—å½“å‰é€‰æ‹©æ€§
         â†“
    é€‰æ‹©æ€§ >= 0.9ï¼Ÿ
    â†™        â†˜
   æ˜¯          å¦
   â†“          â†“
å¼ºçƒˆæ¨èå»ºç´¢å¼•  é€‰æ‹©æ€§ >= 0.3ï¼Ÿ
   â†“          â†™        â†˜  
  ç»“æŸ         æ˜¯          å¦
             â†“          â†“
       æŸ¥è¯¢é¢‘ç‡é«˜ï¼Ÿ   ä¸å»ºè®®å»ºç´¢å¼•
       â†™        â†˜      â†“
      æ˜¯          å¦     ç»“æŸ
      â†“          â†“
   è€ƒè™‘å»ºç´¢å¼•   ä¸å»ºè®®å»ºç´¢å¼•
      â†“          â†“
     ç»“æŸ        ç»“æŸ
```

### 13.4 æœ€ä½³å®è·µæŒ‡å—


**ğŸ¯ é€‰æ‹©æ€§åˆ†ææœ€ä½³å®è·µ**
```
åˆ†æé¢‘ç‡ï¼š
â€¢ æ ¸å¿ƒä¸šåŠ¡è¡¨ï¼šæ¯å¤©åˆ†æ
â€¢ ä¸€èˆ¬ä¸šåŠ¡è¡¨ï¼šæ¯å‘¨åˆ†æ  
â€¢ å†å²æ•°æ®è¡¨ï¼šæ¯æœˆåˆ†æ

è®¡ç®—ç²¾åº¦ï¼š
â€¢ ç”Ÿäº§å†³ç­–ï¼šä½¿ç”¨é«˜ç²¾åº¦ç®—æ³•
â€¢ å¿«é€Ÿè¯„ä¼°ï¼šä½¿ç”¨é‡‡æ ·ä¼°ç®—
â€¢ å®æ—¶ç›‘æ§ï¼šä½¿ç”¨è¿‘ä¼¼ç®—æ³•

é˜ˆå€¼è®¾ç½®ï¼š
â€¢ é«˜é¢‘æŸ¥è¯¢å­—æ®µï¼šé˜ˆå€¼å¯é€‚å½“é™ä½
â€¢ ä½é¢‘æŸ¥è¯¢å­—æ®µï¼šé˜ˆå€¼åº”è¯¥æé«˜
â€¢ æ‰¹é‡å¤„ç†åœºæ™¯ï¼šé˜ˆå€¼å¯ä»¥æ”¾æ¾
```

**âš¡ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
è®¡ç®—ä¼˜åŒ–ï¼š
â€¢ å¤§è¡¨ä¼˜å…ˆä½¿ç”¨é‡‡æ ·æ–¹æ³•
â€¢ åˆ©ç”¨å·²æœ‰ç»Ÿè®¡ä¿¡æ¯å¿«é€Ÿä¼°ç®—
â€¢ å¹¶è¡Œè®¡ç®—å¤šä¸ªå­—æ®µæé«˜æ•ˆç‡
â€¢ å¢é‡è®¡ç®—å‡å°‘é‡å¤å·¥ä½œ

ç›‘æ§ä¼˜åŒ–ï¼š
â€¢ åˆç†è®¾ç½®ç›‘æ§é¢‘ç‡
â€¢ é‡ç‚¹ç›‘æ§æ ¸å¿ƒä¸šåŠ¡è¡¨
â€¢ ä½¿ç”¨å¼‚æ­¥å¤„ç†é¿å…é˜»å¡
â€¢ å»ºç«‹å¤šçº§å‘Šè­¦æœºåˆ¶

å­˜å‚¨ä¼˜åŒ–ï¼š
â€¢ å®šæœŸæ¸…ç†å†å²ç›‘æ§æ•°æ®
â€¢ å‹ç¼©å­˜å‚¨é€‰æ‹©æ€§å†å²è®°å½•
â€¢ ä½¿ç”¨åˆ†åŒºè¡¨ç®¡ç†å¤§é‡ç›‘æ§æ•°æ®
```

**ğŸ”§ å·¥å…·ä½¿ç”¨å»ºè®®**
```
æ—¥å¸¸è¿ç»´ï¼š
â€¢ å®šæœŸæ‰§è¡Œé€‰æ‹©æ€§åˆ†æè„šæœ¬
â€¢ ç›‘æ§é€‰æ‹©æ€§å¼‚å¸¸å‘Šè­¦
â€¢ å®¡æŸ¥ç´¢å¼•ä¼˜åŒ–å»ºè®®
â€¢ è·Ÿè¸ªä¼˜åŒ–æ•ˆæœ

æ•…éšœæ’æŸ¥ï¼š
â€¢ æŸ¥è¯¢æ€§èƒ½é—®é¢˜æ—¶ä¼˜å…ˆæ£€æŸ¥é€‰æ‹©æ€§
â€¢ ç»“åˆæ‰§è¡Œè®¡åˆ’åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
â€¢ å¯¹æ¯”å†å²é€‰æ‹©æ€§æ•°æ®æ‰¾å‡ºå˜åŒ–åŸå› 

å®¹é‡è§„åˆ’ï¼š
â€¢ é¢„æµ‹æ•°æ®å¢é•¿å¯¹é€‰æ‹©æ€§çš„å½±å“
â€¢ è§„åˆ’ç´¢å¼•å­˜å‚¨ç©ºé—´éœ€æ±‚
â€¢ è¯„ä¼°ç´¢å¼•ç»´æŠ¤æˆæœ¬
```

### 13.5 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡ä»·å€¼ä½“ç°**
```
æ€§èƒ½æå‡ï¼š
â€¢ é€šè¿‡é€‰æ‹©æ€§åˆ†æè¯†åˆ«ä½æ•ˆç´¢å¼•ï¼Œåˆ é™¤åæå‡30-50%å†™å…¥æ€§èƒ½
â€¢ å‘ç°ç¼ºå¤±çš„é«˜é€‰æ‹©æ€§ç´¢å¼•ï¼Œåˆ›å»ºåæŸ¥è¯¢æ€§èƒ½æå‡10-100å€
â€¢ ä¼˜åŒ–å¤åˆç´¢å¼•å­—æ®µé¡ºåºï¼ŒæŸ¥è¯¢æ•ˆç‡æå‡2-5å€

æˆæœ¬èŠ‚çº¦ï¼š
â€¢ åˆ é™¤æ— ç”¨ç´¢å¼•èŠ‚çœ20-40%å­˜å‚¨ç©ºé—´
â€¢ å‡å°‘ç´¢å¼•ç»´æŠ¤æˆæœ¬
â€¢ é™ä½æœåŠ¡å™¨èµ„æºæ¶ˆè€—

é£é™©æ§åˆ¶ï¼š
â€¢ åŠæ—¶å‘ç°é€‰æ‹©æ€§ä¸‹é™ï¼Œé¢„é˜²æ€§èƒ½é—®é¢˜
â€¢ è‡ªåŠ¨åŒ–ç›‘æ§å‡å°‘äººå·¥é”™è¯¯
â€¢ å®Œå–„çš„å‘Šè­¦æœºåˆ¶ä¿éšœç³»ç»Ÿç¨³å®š
```

**ğŸ’¼ å…·ä½“åº”ç”¨åœºæ™¯**
```
ç”µå•†å¹³å°ï¼š
â€¢ å•†å“æœç´¢ï¼šåŸºäºå“ç±»+ä»·æ ¼åŒºé—´çš„å¤åˆç´¢å¼•ä¼˜åŒ–
â€¢ è®¢å•æŸ¥è¯¢ï¼šåŸºäºç”¨æˆ·+æ—¶é—´çš„ç´¢å¼•é€‰æ‹©æ€§åˆ†æ
â€¢ åº“å­˜ç®¡ç†ï¼šåŸºäºå•†å“+ä»“åº“çš„ç´¢å¼•æ•ˆæœè¯„ä¼°

é‡‘èç³»ç»Ÿï¼š
â€¢ äº¤æ˜“è®°å½•ï¼šåŸºäºè´¦æˆ·+æ—¶é—´çš„é«˜é€‰æ‹©æ€§ç´¢å¼•
â€¢ é£æ§è§„åˆ™ï¼šåŸºäºç”¨æˆ·ç‰¹å¾çš„å¤åˆç´¢å¼•ä¼˜åŒ–
â€¢ æŠ¥è¡¨æŸ¥è¯¢ï¼šåŸºäºæ—¶é—´ç»´åº¦çš„ç´¢å¼•é€‰æ‹©æ€§ç›‘æ§

å†…å®¹å¹³å°ï¼š
â€¢ æ–‡ç« æœç´¢ï¼šåŸºäºæ ‡ç­¾+åˆ†ç±»çš„ç´¢å¼•é€‰æ‹©æ€§åˆ†æ
â€¢ ç”¨æˆ·è¡Œä¸ºï¼šåŸºäºç”¨æˆ·+è¡Œä¸ºç±»å‹çš„ç´¢å¼•ä¼˜åŒ–
â€¢ æ¨èç³»ç»Ÿï¼šåŸºäºå†…å®¹ç‰¹å¾çš„ç´¢å¼•æ•ˆæœè¯„ä¼°
```

### 13.6 å­¦ä¹ è·¯å¾„æŒ‡å¯¼


**ğŸ“š çŸ¥è¯†æŒæ¡è·¯å¾„**
```
ç¬¬1é˜¶æ®µï¼šç†è§£åŸºç¡€æ¦‚å¿µ
â€¢ ä»€ä¹ˆæ˜¯é€‰æ‹©æ€§å’ŒåŸºæ•°
â€¢ é€‰æ‹©æ€§ä¸æŸ¥è¯¢æ€§èƒ½çš„å…³ç³»
â€¢ åŸºæœ¬çš„è®¡ç®—æ–¹æ³•

ç¬¬2é˜¶æ®µï¼šæŒæ¡è®¡ç®—æŠ€æœ¯  
â€¢ ç²¾ç¡®è®¡ç®—å’Œè¿‘ä¼¼ç®—æ³•
â€¢ é‡‡æ ·æ–¹æ³•çš„é€‰æ‹©å’Œä½¿ç”¨
â€¢ å¤åˆç´¢å¼•é€‰æ‹©æ€§åˆ†æ

ç¬¬3é˜¶æ®µï¼šæ„å»ºç›‘æ§ä½“ç³»
â€¢ è®¾è®¡åŠ¨æ€ç›‘æ§ç³»ç»Ÿ
â€¢ å®ç°å¼‚å¸¸æ£€æµ‹å‘Šè­¦
â€¢ å»ºç«‹è¶‹åŠ¿åˆ†ææ¨¡å‹

ç¬¬4é˜¶æ®µï¼šå†³ç­–æ”¯æŒç³»ç»Ÿ
â€¢ è‡ªåŠ¨åŒ–ç´¢å¼•å»ºè®®
â€¢ æˆæœ¬æ•ˆç›Šåˆ†æ
â€¢ ç»´æŠ¤ç­–ç•¥åˆ¶å®š
```

**ğŸ› ï¸ å®è·µé¡¹ç›®å»ºè®®**
```
å…¥é—¨é¡¹ç›®ï¼š
â€¢ åˆ†æç°æœ‰ç³»ç»Ÿçš„ç´¢å¼•é€‰æ‹©æ€§
â€¢ è¯†åˆ«å’Œæ¸…ç†ä½é€‰æ‹©æ€§ç´¢å¼•
â€¢ å®ç°åŸºæœ¬çš„é€‰æ‹©æ€§è®¡ç®—å·¥å…·

è¿›é˜¶é¡¹ç›®ï¼š
â€¢ æ„å»ºé€‰æ‹©æ€§ç›‘æ§ç³»ç»Ÿ
â€¢ å®ç°è‡ªåŠ¨åŒ–ç´¢å¼•å»ºè®®åŠŸèƒ½
â€¢ å¼€å‘é€‰æ‹©æ€§é¢„æµ‹æ¨¡å‹

é«˜çº§é¡¹ç›®ï¼š
â€¢ æ„å»ºä¼ä¸šçº§ç´¢å¼•ä¼˜åŒ–å¹³å°
â€¢ å®ç°å¤šæ•°æ®åº“çš„é€‰æ‹©æ€§åˆ†æ
â€¢ å¼€å‘æ™ºèƒ½ç´¢å¼•å†³ç­–æ”¯æŒç³»ç»Ÿ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ğŸ’¡ "é€‰æ‹©æ€§ä¼˜åŒ–å…«å­—è¯€"
é«˜é€‰æ‹©æ€§å¿«æŸ¥è¯¢ï¼Œä½é€‰æ‹©æ€§è¦åˆ é™¤
å¤åˆç´¢å¼•çœ‹ç»„åˆï¼Œç›‘æ§é¢„è­¦ä¿ç¨³å®š
```

**ğŸ¯ å…³é”®ç†è§£**ï¼š
- é€‰æ‹©æ€§æ˜¯ç´¢å¼•æ•ˆæœçš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œç›´æ¥å½±å“æŸ¥è¯¢æ€§èƒ½
- ä¸æ˜¯æ‰€æœ‰å­—æ®µéƒ½é€‚åˆå»ºç´¢å¼•ï¼Œè¦çœ‹é€‰æ‹©æ€§é«˜ä½
- å¤åˆç´¢å¼•çš„å­—æ®µé¡ºåºå¾ˆé‡è¦ï¼Œé«˜é€‰æ‹©æ€§åœ¨å‰
- é€‰æ‹©æ€§ä¼šéšæ•°æ®å˜åŒ–ï¼Œéœ€è¦æŒç»­ç›‘æ§
- è‡ªåŠ¨åŒ–å·¥å…·èƒ½å¤§å¤§æé«˜åˆ†ææ•ˆç‡å’Œå‡†ç¡®æ€§
- æˆæœ¬æ•ˆç›Šåˆ†æå¸®åŠ©åšå‡ºæœ€ä¼˜çš„ç´¢å¼•å†³ç­–