---
title: 3ã€è¦†ç›–ç´¢å¼•è®¾è®¡å®è·µ
---
## ğŸ“š ç›®å½•

1. [è¦†ç›–ç´¢å¼•åŸºç¡€æ¦‚å¿µ](#1-è¦†ç›–ç´¢å¼•åŸºç¡€æ¦‚å¿µ)
2. [è¦†ç›–ç´¢å¼•å·¥ä½œåŸç†](#2-è¦†ç›–ç´¢å¼•å·¥ä½œåŸç†)
3. [è¦†ç›–ç´¢å¼•è®¾è®¡ç­–ç•¥](#3-è¦†ç›–ç´¢å¼•è®¾è®¡ç­–ç•¥)
4. [è¦†ç›–ç´¢å¼•æ€§èƒ½ä¼˜åŒ–](#4-è¦†ç›–ç´¢å¼•æ€§èƒ½ä¼˜åŒ–)
5. [è¦†ç›–ç´¢å¼•ç›‘æ§ä¸ç»´æŠ¤](#5-è¦†ç›–ç´¢å¼•ç›‘æ§ä¸ç»´æŠ¤)
6. [è¦†ç›–ç´¢å¼•è®¾è®¡è‡ªåŠ¨åŒ–](#6-è¦†ç›–ç´¢å¼•è®¾è®¡è‡ªåŠ¨åŒ–)
7. [è¦†ç›–ç´¢å¼•æˆæœ¬æ”¶ç›Šåˆ†æ](#7-è¦†ç›–ç´¢å¼•æˆæœ¬æ”¶ç›Šåˆ†æ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“– è¦†ç›–ç´¢å¼•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•


**ğŸ”¸ é€šä¿—ç†è§£**
è¦†ç›–ç´¢å¼•å°±åƒæ˜¯ä¸€æœ¬"ç²¾ç®€ç‰ˆå­—å…¸"ï¼Œä½ è¦æŸ¥çš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ç´¢å¼•é¡µé¢ä¸Šï¼Œä¸ç”¨å†ç¿»åˆ°æ­£æ–‡å»æ‰¾ã€‚

```
æ™®é€šæŸ¥è¯¢è¿‡ç¨‹ï¼š
ç”¨æˆ·æŸ¥è¯¢ â†’ æ‰¾åˆ°ç´¢å¼• â†’ æ ¹æ®ç´¢å¼•æ‰¾åˆ°æ•°æ®è¡Œ â†’ è¯»å–å®Œæ•´æ•°æ®
      â†‘_________________å›è¡¨æ“ä½œ_________________â†‘

è¦†ç›–ç´¢å¼•æŸ¥è¯¢ï¼š
ç”¨æˆ·æŸ¥è¯¢ â†’ æ‰¾åˆ°ç´¢å¼• â†’ ç›´æ¥ä»ç´¢å¼•è·å–æ‰€éœ€æ•°æ® âœ…
                   â†‘__æ— éœ€å›è¡¨ï¼Œç›´æ¥è¿”å›__â†‘
```

**ğŸ“‹ æ­£å¼å®šä¹‰**
è¦†ç›–ç´¢å¼•æ˜¯æŒ‡æŸ¥è¯¢è¯­å¥æ‰€éœ€çš„æ‰€æœ‰å­—æ®µéƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢å°±èƒ½ç›´æ¥ä»ç´¢å¼•è·å–æ•°æ®çš„ç´¢å¼•è®¾è®¡ã€‚

### 1.2 è¦†ç›–ç´¢å¼•è§£å†³çš„æ ¸å¿ƒé—®é¢˜


**ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šå›è¡¨æ“ä½œçš„æ€§èƒ½å¼€é”€**

```
ä¼ ç»ŸäºŒçº§ç´¢å¼•çš„é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äºŒçº§ç´¢å¼•     â”‚    â”‚ ä¸»é”®ç´¢å¼•     â”‚
â”‚ name | id   â”‚    â”‚ id | å®Œæ•´è¡Œ  â”‚
â”‚ Alice| 101  â”‚â”€â”€â”€â†’â”‚ 101| Alice.. â”‚
â”‚ Bob  | 102  â”‚    â”‚ 102| Bob...  â”‚
â”‚ Carol| 103  â”‚    â”‚ 103| Carol.. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     ç¬¬ä¸€æ­¥             ç¬¬äºŒæ­¥
  æ‰¾åˆ°åŒ¹é…è¡Œ          æ ¹æ®IDå›è¡¨

æ€§èƒ½å¼€é”€ï¼š
â€¢ ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾
â€¢ é¢å¤–çš„ç£ç›˜IO
â€¢ éšæœºè®¿é—®æ¨¡å¼
```

**ğŸ’¡ è¦†ç›–ç´¢å¼•çš„è§£å†³æ–¹æ¡ˆ**
```
SELECT name, age FROM users WHERE name = 'Alice';

æ™®é€šç´¢å¼• idx_name (name)ï¼š
1. é€šè¿‡nameç´¢å¼•æ‰¾åˆ°id=101
2. å›è¡¨æŸ¥è¯¢è·å–ageå­—æ®µ  â† é¢å¤–å¼€é”€

è¦†ç›–ç´¢å¼• idx_name_age (name, age)ï¼š
1. é€šè¿‡nameç´¢å¼•ç›´æ¥è·å–age  â† ä¸€æ­¥åˆ°ä½
2. æ— éœ€å›è¡¨æ“ä½œ  â† æ€§èƒ½æå‡50-80%
```

### 1.3 è¦†ç›–ç´¢å¼•vsæ™®é€šç´¢å¼•çš„æœ¬è´¨åŒºåˆ«


**ğŸ“Š æ ¸å¿ƒå·®å¼‚å¯¹æ¯”**

| å¯¹æ¯”é¡¹ç›® | **æ™®é€šç´¢å¼•** | **è¦†ç›–ç´¢å¼•** | **æ€§èƒ½æå‡** |
|---------|-------------|-------------|-------------|
| **æŸ¥è¯¢æ­¥éª¤** | `ç´¢å¼•æŸ¥æ‰¾â†’å›è¡¨æŸ¥è¯¢` | `ç´¢å¼•æŸ¥æ‰¾å®Œæˆ` | `å‡å°‘50%æ“ä½œ` |
| **ç£ç›˜IO** | `è‡³å°‘2æ¬¡éšæœºIO` | `1æ¬¡é¡ºåºIO` | `IOå‡å°‘60-80%` |
| **å†…å­˜ä½¿ç”¨** | `éœ€è¦ç¼“å­˜æ•°æ®é¡µ` | `åªéœ€ç¼“å­˜ç´¢å¼•é¡µ` | `å†…å­˜æ•ˆç‡æå‡` |
| **é”ç«äº‰** | `å¯èƒ½é”æ•°æ®è¡Œ` | `åªè¯»ç´¢å¼•é¡µ` | `é”ç«äº‰å‡å°‘` |

---

## 2. âš™ï¸ è¦†ç›–ç´¢å¼•å·¥ä½œåŸç†


### 2.1 InnoDBç´¢å¼•ç»“æ„å›é¡¾


**ğŸŒ³ B+æ ‘ç´¢å¼•ç»“æ„ç®€åŒ–å›¾**
```
                  ä¸»é”®ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ï¼‰
                 â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
                 â”‚ 100 â”‚ 200 â”‚ 300 â”‚
                 â””â”€â”¬â”€â”¬â”€â”´â”€â”¬â”€â”¬â”€â”´â”€â”¬â”€â”¬â”€â”˜
                   â”‚ â”‚   â”‚ â”‚   â”‚ â”‚
                   V V   V V   V V
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ å®Œæ•´çš„æ•°æ®è¡Œå†…å®¹      â”‚
              â”‚ id|name|age|email... â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                  äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ï¼‰
                 â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
                 â”‚Aliceâ”‚ Bob â”‚Carolâ”‚
                 â””â”€â”¬â”€â”¬â”€â”´â”€â”¬â”€â”¬â”€â”´â”€â”¬â”€â”¬â”€â”˜
                   â”‚ â”‚   â”‚ â”‚   â”‚ â”‚
                   V V   V V   V V
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ å¯¹åº”çš„ä¸»é”®IDå€¼       â”‚
              â”‚ 101 â”‚ 102 â”‚ 103    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                   éœ€è¦å›è¡¨æŸ¥è¯¢ â† æ€§èƒ½ç“¶é¢ˆ
```

### 2.2 è¦†ç›–ç´¢å¼•çš„æ•°æ®ç»„ç»‡æ–¹å¼


**ğŸ’¡ è¦†ç›–ç´¢å¼•å¦‚ä½•é¿å…å›è¡¨**

```
æ™®é€šäºŒçº§ç´¢å¼• idx_name (name)ï¼š
ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨ï¼š[nameå€¼, ä¸»é”®ID]
æŸ¥è¯¢ SELECT name, ageï¼šéœ€è¦å›è¡¨è·å–age

è¦†ç›–ç´¢å¼• idx_name_age (name, age)ï¼š
ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨ï¼š[nameå€¼, ageå€¼, ä¸»é”®ID]
æŸ¥è¯¢ SELECT name, ageï¼šç›´æ¥ä»ç´¢å¼•è·å–ï¼Œæ— éœ€å›è¡¨

å…³é”®ç†è§£ï¼š
è¦†ç›–ç´¢å¼•æŠŠ"ç»å¸¸ä¸€èµ·æŸ¥è¯¢çš„å­—æ®µ"éƒ½æ”¾åœ¨äº†ç´¢å¼•é‡Œ
å°±åƒæŠŠå¸¸ç”¨å·¥å…·æ”¾åœ¨å·¥å…·ç®±è¡¨é¢ï¼Œä¸ç”¨ç¿»ç®±å€’æŸœ
```

### 2.3 è¦†ç›–ç´¢å¼•çš„è¯†åˆ«æ–¹æ³•


**ğŸ” å¦‚ä½•åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•**

```sql
-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT name, age FROM users WHERE name = 'Alice';

å…³é”®æŒ‡æ ‡ï¼š
â€¢ Extraåˆ—æ˜¾ç¤º "Using index" â† ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•
â€¢ typeåˆ—æ˜¾ç¤º "ref" æˆ– "range" â† ç´¢å¼•è®¿é—®æ–¹å¼
â€¢ rowsåˆ—æ•°å€¼è¾ƒå° â† æ‰«æè¡Œæ•°å°‘

ç¤ºä¾‹è¾“å‡ºï¼š
+----+------+----------+------+---------------+------+
| id | type | key      | rows | Extra         |      |
+----+------+----------+------+---------------+------+
|  1 | ref  | idx_name |    1 | Using index   | âœ…   |
+----+------+----------+------+---------------+------+
```

**ğŸ“Š æ€§èƒ½ç›‘æ§SQL**
```sql
-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡
SELECT 
    OBJECT_NAME,
    INDEX_NAME,
    COUNT_READ,
    COUNT_FETCH,
    SUM_TIMER_FETCH/COUNT_FETCH as avg_fetch_time
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE OBJECT_NAME = 'users'
ORDER BY COUNT_READ DESC;
```

---

## 3. ğŸ¯ è¦†ç›–ç´¢å¼•è®¾è®¡ç­–ç•¥


### 3.1 è¦†ç›–ç´¢å¼•è®¾è®¡åŸºæœ¬åŸåˆ™


**ğŸ”¸ æ ¸å¿ƒè®¾è®¡æ€è·¯**
```
åŸåˆ™1ï¼šæŸ¥è¯¢é©±åŠ¨è®¾è®¡
â†’ å…ˆåˆ†æé«˜é¢‘æŸ¥è¯¢æ¨¡å¼ï¼Œå†è®¾è®¡è¦†ç›–ç´¢å¼•

åŸåˆ™2ï¼šå­—æ®µç»„åˆä¼˜åŒ–
â†’ å°†ç»å¸¸ä¸€èµ·æŸ¥è¯¢çš„å­—æ®µç»„åˆåœ¨ä¸€ä¸ªç´¢å¼•ä¸­

åŸåˆ™3ï¼šæˆæœ¬æ•ˆç›Šå¹³è¡¡
â†’ æƒè¡¡å­˜å‚¨å¼€é”€ä¸æŸ¥è¯¢æ€§èƒ½æå‡

åŸåˆ™4ï¼šç»´æŠ¤æˆæœ¬è€ƒè™‘
â†’ è€ƒè™‘æ’å…¥ã€æ›´æ–°ã€åˆ é™¤çš„ç´¢å¼•ç»´æŠ¤å¼€é”€
```

### 3.2 è¦†ç›–ç´¢å¼•é€‚ç”¨åœºæ™¯åˆ†æ


**âœ… é«˜ä»·å€¼åº”ç”¨åœºæ™¯**

```
ğŸ¯ åœºæ™¯1ï¼šé¢‘ç¹çš„åˆ—è¡¨æŸ¥è¯¢
ä¸šåŠ¡éœ€æ±‚ï¼šç”¨æˆ·åˆ—è¡¨é¡µé¢
æŸ¥è¯¢è¯­å¥ï¼šSELECT id, name, status FROM users WHERE status = 'active';
ç´¢å¼•è®¾è®¡ï¼šidx_status_id_name (status, id, name)
æ”¶ç›Šè¯„ä¼°ï¼šé¿å…å›è¡¨ï¼Œæ€§èƒ½æå‡70%

ğŸ¯ åœºæ™¯2ï¼šç»Ÿè®¡åˆ†ææŸ¥è¯¢  
ä¸šåŠ¡éœ€æ±‚ï¼šè®¢å•é‡‘é¢ç»Ÿè®¡
æŸ¥è¯¢è¯­å¥ï¼šSELECT COUNT(*), SUM(amount) FROM orders WHERE date >= '2025-01-01';
ç´¢å¼•è®¾è®¡ï¼šidx_date_amount (date, amount)
æ”¶ç›Šè¯„ä¼°ï¼šç´¢å¼•æ‰«æä»£æ›¿å…¨è¡¨æ‰«æ

ğŸ¯ åœºæ™¯3ï¼šå…³è”æŸ¥è¯¢ä¼˜åŒ–
ä¸šåŠ¡éœ€æ±‚ï¼šç”¨æˆ·è®¢å•å…³è”
æŸ¥è¯¢è¯­å¥ï¼šSELECT u.name, o.amount FROM users u JOIN orders o ON u.id = o.user_id;
ç´¢å¼•è®¾è®¡ï¼šidx_user_id_amount (user_id, amount) on ordersè¡¨
æ”¶ç›Šè¯„ä¼°ï¼šå‡å°‘JOINè¿‡ç¨‹ä¸­çš„å›è¡¨æ“ä½œ
```

**âŒ ä¸é€‚ç”¨çš„åœºæ™¯**
```
âš ï¸ é¿å…çš„æƒ…å†µï¼š
â€¢ æŸ¥è¯¢å­—æ®µå˜åŒ–é¢‘ç¹
â€¢ åŒ…å«å¤§å­—æ®µï¼ˆTEXTã€BLOBï¼‰
â€¢ å†™å…¥æ“ä½œè¿œå¤šäºè¯»å–æ“ä½œ
â€¢ å­—æ®µç»„åˆè¿‡å¤šå¯¼è‡´ç´¢å¼•è¿‡å¤§
```

### 3.3 è¦†ç›–ç´¢å¼•å­—æ®µé€‰æ‹©ç­–ç•¥


**ğŸ”§ å­—æ®µé€‰æ‹©çš„å†³ç­–æµç¨‹**

```
æ­¥éª¤1ï¼šåˆ†ææŸ¥è¯¢æ¨¡å¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ”¶é›†é«˜é¢‘SQL     â”‚
â”‚ åˆ†æSELECTå­—æ®µ  â”‚ â†’ ç¡®å®šå€™é€‰å­—æ®µ
â”‚ ç»Ÿè®¡æŸ¥è¯¢é¢‘æ¬¡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
æ­¥éª¤2ï¼šè¯„ä¼°å­—æ®µç‰¹å¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µå¤§å°        â”‚
â”‚ æ›´æ–°é¢‘ç‡        â”‚ â†’ è®¡ç®—ç»´æŠ¤æˆæœ¬
â”‚ é€‰æ‹©æ€§é«˜ä½      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
æ­¥éª¤3ï¼šç»„åˆä¼˜åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µé¡ºåºå®‰æ’    â”‚
â”‚ ç´¢å¼•å¤§å°æ§åˆ¶    â”‚ â†’ æœ€ç»ˆç´¢å¼•è®¾è®¡
â”‚ æ€§èƒ½æ”¶ç›Šè¯„ä¼°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š å­—æ®µé€‰æ‹©è¯„ä¼°çŸ©é˜µ**

| å­—æ®µç‰¹å¾ | **é«˜ä¼˜å…ˆçº§** | **ä¸­ä¼˜å…ˆçº§** | **ä½ä¼˜å…ˆçº§** |
|---------|-------------|-------------|-------------|
| **æŸ¥è¯¢é¢‘ç‡** | `>80%æŸ¥è¯¢ä½¿ç”¨` | `30-80%æŸ¥è¯¢ä½¿ç”¨` | `<30%æŸ¥è¯¢ä½¿ç”¨` |
| **å­—æ®µå¤§å°** | `â‰¤8å­—èŠ‚` | `8-32å­—èŠ‚` | `>32å­—èŠ‚` |
| **æ›´æ–°é¢‘ç‡** | `å¾ˆå°‘æ›´æ–°` | `å¶å°”æ›´æ–°` | `é¢‘ç¹æ›´æ–°` |
| **é€‰æ‹©æ€§** | `é«˜é€‰æ‹©æ€§` | `ä¸­ç­‰é€‰æ‹©æ€§` | `ä½é€‰æ‹©æ€§` |

### 3.4 è¦†ç›–ç´¢å¼•è®¾è®¡æ¨¡å¼


**ğŸ—ï¸ å¸¸è§è®¾è®¡æ¨¡å¼**

**æ¨¡å¼1ï¼šç²¾ç¡®åŒ¹é… + è¿”å›å­—æ®µ**
```sql
-- ä¸šåŠ¡åœºæ™¯ï¼šæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢åŸºæœ¬ä¿¡æ¯
SELECT user_id, email, status FROM users WHERE username = ?;

-- ç´¢å¼•è®¾è®¡
CREATE INDEX idx_username_covering 
ON users(username, user_id, email, status);

-- è®¾è®¡è¦ç‚¹ï¼š
-- 1. whereæ¡ä»¶å­—æ®µæ”¾åœ¨æœ€å‰é¢
-- 2. æŸ¥è¯¢è¿”å›å­—æ®µéƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­
-- 3. å­—æ®µé¡ºåºï¼šè¿‡æ»¤å­—æ®µ â†’ æ’åºå­—æ®µ â†’ è¿”å›å­—æ®µ
```

**æ¨¡å¼2ï¼šèŒƒå›´æŸ¥è¯¢ + èšåˆå‡½æ•°**
```sql
-- ä¸šåŠ¡åœºæ™¯ï¼šè®¢å•é‡‘é¢ç»Ÿè®¡
SELECT COUNT(*), SUM(amount), AVG(amount) 
FROM orders 
WHERE create_time >= '2025-01-01' AND status = 'paid';

-- ç´¢å¼•è®¾è®¡
CREATE INDEX idx_status_time_amount 
ON orders(status, create_time, amount);

-- è®¾è®¡è¦ç‚¹ï¼š
-- 1. ç­‰å€¼æ¡ä»¶å­—æ®µä¼˜å…ˆï¼ˆstatusï¼‰
-- 2. èŒƒå›´æ¡ä»¶å­—æ®µå…¶æ¬¡ï¼ˆcreate_timeï¼‰
-- 3. èšåˆå­—æ®µæœ€åï¼ˆamountï¼‰
```

**æ¨¡å¼3ï¼šæ’åº + åˆ†é¡µä¼˜åŒ–**
```sql
-- ä¸šåŠ¡åœºæ™¯ï¼šç”¨æˆ·åˆ—è¡¨åˆ†é¡µ
SELECT user_id, username, register_time 
FROM users 
WHERE status = 'active' 
ORDER BY register_time DESC 
LIMIT 20 OFFSET 100;

-- ç´¢å¼•è®¾è®¡
CREATE INDEX idx_status_time_covering 
ON users(status, register_time DESC, user_id, username);

-- è®¾è®¡è¦ç‚¹ï¼š
-- 1. è¿‡æ»¤å­—æ®µfirstï¼ˆstatusï¼‰
-- 2. æ’åºå­—æ®µsecondï¼ˆregister_timeï¼‰
-- 3. è¿”å›å­—æ®µlastï¼ˆuser_id, usernameï¼‰
-- 4. æ’åºæ–¹å‘è¦åŒ¹é…ï¼ˆDESCï¼‰
```

---

## 4. ğŸš€ è¦†ç›–ç´¢å¼•æ€§èƒ½ä¼˜åŒ–


### 4.1 è¦†ç›–ç´¢å¼•æ€§èƒ½æå‡åŸç†


**âš¡ æ€§èƒ½æå‡çš„æ ¹æœ¬åŸå› **

```
ğŸ”¸ IOæ“ä½œä¼˜åŒ–
ä¼ ç»Ÿç´¢å¼•ï¼šç´¢å¼•é¡µè¯»å– + æ•°æ®é¡µè¯»å–ï¼ˆ2æ¬¡IOï¼‰
è¦†ç›–ç´¢å¼•ï¼šç´¢å¼•é¡µè¯»å–ï¼ˆ1æ¬¡IOï¼‰
æ€§èƒ½æå‡ï¼š50-80%ï¼Œç‰¹åˆ«æ˜¯æœºæ¢°ç¡¬ç›˜ç¯å¢ƒ

ğŸ”¸ å†…å­˜ä½¿ç”¨ä¼˜åŒ–  
ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦ç¼“å­˜ç´¢å¼•é¡µ + æ•°æ®é¡µ
è¦†ç›–ç´¢å¼•ï¼šåªéœ€è¦ç¼“å­˜ç´¢å¼•é¡µ
å†…å­˜æ•ˆç‡ï¼šæå‡30-50%

ğŸ”¸ å¹¶å‘æ€§èƒ½ä¼˜åŒ–
ä¼ ç»Ÿæ–¹å¼ï¼šå¯èƒ½éœ€è¦é”å®šæ•°æ®è¡Œ
è¦†ç›–ç´¢å¼•ï¼šåªè¯»ç´¢å¼•é¡µï¼Œé”ç«äº‰å‡å°‘
å¹¶å‘æ€§èƒ½ï¼šæå‡20-40%
```

### 4.2 è¦†ç›–ç´¢å¼•æ€§èƒ½æµ‹è¯•


**ğŸ“Š æ€§èƒ½å¯¹æ¯”æµ‹è¯•è®¾è®¡**

```sql
-- æµ‹è¯•è¡¨å‡†å¤‡
CREATE TABLE users_test (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50),
    email VARCHAR(100),
    status TINYINT,
    register_time TIMESTAMP,
    last_login TIMESTAMP,
    profile TEXT
);

-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO users_test (username, email, status, register_time) 
SELECT 
    CONCAT('user', seq),
    CONCAT('user', seq, '@test.com'),
    FLOOR(RAND() * 3),
    DATE_SUB(NOW(), INTERVAL FLOOR(RAND() * 365) DAY)
FROM 
    (SELECT @rownum:=@rownum+1 AS seq FROM 
     (SELECT 0 UNION SELECT 1 UNION SELECT 2) t1,
     (SELECT 0 UNION SELECT 1 UNION SELECT 2) t2,
     (SELECT @rownum:=0) r
     LIMIT 1000000) AS numbers;
```

**ğŸ”¬ æ€§èƒ½æµ‹è¯•è„šæœ¬**
```sql
-- æµ‹è¯•1ï¼šæ™®é€šç´¢å¼•
CREATE INDEX idx_status ON users_test(status);

-- æµ‹è¯•2ï¼šè¦†ç›–ç´¢å¼•
CREATE INDEX idx_status_covering 
ON users_test(status, id, username, email, register_time);

-- æ€§èƒ½å¯¹æ¯”æŸ¥è¯¢
SET profiling = 1;

-- æ™®é€šç´¢å¼•æŸ¥è¯¢
SELECT id, username, email, register_time 
FROM users_test 
WHERE status = 1 
LIMIT 100;

-- æŸ¥çœ‹æ€§èƒ½æ•°æ®
SHOW PROFILES;

-- é¢„æœŸç»“æœå¯¹æ¯”
-- æ™®é€šç´¢å¼•ï¼š0.08ç§’ï¼Œ1500æ¬¡IO
-- è¦†ç›–ç´¢å¼•ï¼š0.03ç§’ï¼Œ500æ¬¡IO
-- æ€§èƒ½æå‡ï¼š62.5%
```

### 4.3 éƒ¨åˆ†è¦†ç›–ç´¢å¼•ä¼˜åŒ–


**ğŸ¯ ä»€ä¹ˆæ˜¯éƒ¨åˆ†è¦†ç›–ç´¢å¼•**

å½“æŸ¥è¯¢å­—æ®µå¤ªå¤šæ— æ³•å…¨éƒ¨åŒ…å«åœ¨ç´¢å¼•ä¸­æ—¶ï¼Œå¯ä»¥é‡‡ç”¨"éƒ¨åˆ†è¦†ç›–"ç­–ç•¥ã€‚

**ğŸ’¡ éƒ¨åˆ†è¦†ç›–è®¾è®¡ç­–ç•¥**
```sql
-- åŸæŸ¥è¯¢ï¼šè¿”å›å­—æ®µè¾ƒå¤š
SELECT id, username, email, phone, address, register_time 
FROM users 
WHERE status = 1 AND register_time > '2025-01-01';

-- ç­–ç•¥1ï¼šæ ¸å¿ƒå­—æ®µè¦†ç›–
CREATE INDEX idx_status_time_core 
ON users(status, register_time, id, username, email);
-- è¦†ç›–80%çš„æŸ¥è¯¢å­—æ®µï¼Œå›è¡¨è·å–phone, address

-- ç­–ç•¥2ï¼šé«˜é¢‘å­—æ®µè¦†ç›–
-- åˆ†æå‘ç°60%çš„æŸ¥è¯¢åªéœ€è¦id, username
CREATE INDEX idx_status_time_basic 
ON users(status, register_time, id, username);

-- ç­–ç•¥3ï¼šåˆ†å±‚ç´¢å¼•è®¾è®¡
-- åŸºç¡€ç´¢å¼•ï¼šè¦†ç›–æœ€å¸¸ç”¨å­—æ®µ
-- æ‰©å±•ç´¢å¼•ï¼šè¦†ç›–ç‰¹å®šä¸šåŠ¡åœºæ™¯
```

**ğŸ“ˆ éƒ¨åˆ†è¦†ç›–æ•ˆæœè¯„ä¼°**
```
è¦†ç›–ç‡è®¡ç®—ï¼š
è¦†ç›–å­—æ®µæ•° / æ€»æŸ¥è¯¢å­—æ®µæ•° = è¦†ç›–ç‡

æ€§èƒ½æå‡é¢„ä¼°ï¼š
80%è¦†ç›–ç‡ â†’ 65%æ€§èƒ½æå‡
60%è¦†ç›–ç‡ â†’ 45%æ€§èƒ½æå‡
40%è¦†ç›–ç‡ â†’ 25%æ€§èƒ½æå‡

è®¾è®¡å»ºè®®ï¼š
è¦†ç›–ç‡ > 70%ï¼šå»ºè®®åˆ›å»ºè¦†ç›–ç´¢å¼•
è¦†ç›–ç‡ 50-70%ï¼šè€ƒè™‘ä¸šåŠ¡é‡è¦æ€§å†³å®š
è¦†ç›–ç‡ < 50%ï¼šé€šå¸¸ä¸æ¨è
```

---

## 5. ğŸ“Š è¦†ç›–ç´¢å¼•ç›‘æ§ä¸ç»´æŠ¤


### 5.1 è¦†ç›–ç´¢å¼•ä½¿ç”¨æƒ…å†µç›‘æ§


**ğŸ“ˆ ç›‘æ§æŒ‡æ ‡ä½“ç³»**

```sql
-- 1. ç´¢å¼•ä½¿ç”¨é¢‘ç‡ç›‘æ§
SELECT 
    OBJECT_NAME as table_name,
    INDEX_NAME,
    COUNT_FETCH as index_reads,
    COUNT_INSERT as index_writes,
    SUM_TIMER_FETCH/1000000000 as total_read_time_sec,
    ROUND(SUM_TIMER_FETCH/COUNT_FETCH/1000000, 2) as avg_read_time_ms
FROM performance_schema.table_io_waits_summary_by_index_usage 
WHERE OBJECT_SCHEMA = 'your_database'
  AND INDEX_NAME IS NOT NULL
ORDER BY COUNT_FETCH DESC;

-- 2. å›è¡¨æ“ä½œç›‘æ§
SELECT 
    DIGEST_TEXT as query_pattern,
    COUNT_STAR as exec_count,
    ROUND(AVG_TIMER_WAIT/1000000000, 3) as avg_time_sec,
    SUM_ROWS_EXAMINED/COUNT_STAR as avg_rows_examined
FROM performance_schema.events_statements_summary_by_digest 
WHERE DIGEST_TEXT LIKE '%SELECT%'
  AND SUM_ROWS_EXAMINED > SUM_ROWS_SENT * 2  -- å›è¡¨æ¯”ç‡é«˜çš„æŸ¥è¯¢
ORDER BY exec_count DESC;
```

### 5.2 è¦†ç›–ç´¢å¼•æ•ˆæœè¯„ä¼°


**ğŸ“‹ æ•ˆæœè¯„ä¼°æŒ‡æ ‡**

```sql
-- è¦†ç›–ç´¢å¼•æ•ˆæœè¯„ä¼°æŸ¥è¯¢
WITH index_stats AS (
    SELECT 
        t.TABLE_NAME,
        t.INDEX_NAME,
        t.COLUMN_NAME,
        s.COUNT_READ,
        s.COUNT_FETCH,
        s.SUM_TIMER_READ/1000000000 as read_time_sec
    FROM information_schema.STATISTICS t
    JOIN performance_schema.table_io_waits_summary_by_index_usage s
        ON t.TABLE_NAME = s.OBJECT_NAME 
        AND t.INDEX_NAME = s.INDEX_NAME
    WHERE t.TABLE_SCHEMA = 'your_db'
)
SELECT 
    TABLE_NAME,
    INDEX_NAME,
    COUNT(COLUMN_NAME) as column_count,
    COUNT_READ,
    ROUND(read_time_sec, 3) as avg_read_time,
    ROUND(COUNT_READ/read_time_sec, 0) as reads_per_second
FROM index_stats 
GROUP BY TABLE_NAME, INDEX_NAME, COUNT_READ, read_time_sec
ORDER BY COUNT_READ DESC;
```

> ğŸ’¡ **ç›‘æ§å»ºè®®**  
> å»ºç«‹ç›‘æ§dashbordï¼Œè·Ÿè¸ªè¦†ç›–ç´¢å¼•çš„ä½¿ç”¨ç‡ã€æ€§èƒ½æå‡æ•ˆæœå’Œæˆæœ¬å¼€é”€ï¼Œå®šæœŸè¯„ä¼°æŠ•èµ„å›æŠ¥ç‡

### 5.3 è¦†ç›–ç´¢å¼•ç»´æŠ¤ç­–ç•¥


**ğŸ”§ ç»´æŠ¤æ“ä½œæŒ‡å—**

```sql
-- 1. ç´¢å¼•ä½¿ç”¨ç‡æ£€æŸ¥
SELECT 
    INDEX_NAME,
    COUNT_READ,
    ROUND(COUNT_READ * 100.0 / (
        SELECT SUM(COUNT_READ) 
        FROM performance_schema.table_io_waits_summary_by_index_usage 
        WHERE OBJECT_NAME = 'users'
    ), 2) as usage_percentage
FROM performance_schema.table_io_waits_summary_by_index_usage 
WHERE OBJECT_NAME = 'users' 
  AND INDEX_NAME != 'PRIMARY'
ORDER BY usage_percentage DESC;

-- 2. ä½æ•ˆç´¢å¼•è¯†åˆ«
-- è¯†åˆ«åˆ›å»ºåå¾ˆå°‘ä½¿ç”¨çš„è¦†ç›–ç´¢å¼•
SELECT 
    INDEX_NAME,
    COUNT_READ,
    CARDINALITY,
    ROUND(CARDINALITY/COUNT_READ, 2) as efficiency_ratio
FROM performance_schema.table_io_waits_summary_by_index_usage p
JOIN information_schema.STATISTICS s ON p.INDEX_NAME = s.INDEX_NAME
WHERE p.OBJECT_NAME = 'users'
  AND COUNT_READ < 1000  -- ä½¿ç”¨æ¬¡æ•°å°‘
  AND s.SEQ_IN_INDEX = 1; -- åªçœ‹ç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µ
```

**ğŸ”„ åŠ¨æ€è¦†ç›–ç´¢å¼•è°ƒæ•´**

```sql
-- æ ¹æ®ä¸šåŠ¡å˜åŒ–è°ƒæ•´ç´¢å¼•ç»“æ„
-- åœºæ™¯ï¼šä¸šåŠ¡éœ€æ±‚å˜åŒ–ï¼ŒæŸ¥è¯¢æ¨¡å¼æ”¹å˜

-- åŸç´¢å¼•ï¼šidx_name_email (name, email)
-- æ–°éœ€æ±‚ï¼šå¢åŠ statuså­—æ®µçš„æŸ¥è¯¢

-- è°ƒæ•´ç­–ç•¥ï¼š
-- 1. åˆ›å»ºæ–°çš„è¦†ç›–ç´¢å¼•
CREATE INDEX idx_status_name_email ON users(status, name, email);

-- 2. ç›‘æ§æ–°ç´¢å¼•ä½¿ç”¨æƒ…å†µ
-- ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè§‚å¯Ÿä½¿ç”¨ç»Ÿè®¡

-- 3. åˆ é™¤æ—§ç´¢å¼•ï¼ˆè°¨æ…æ“ä½œï¼‰
-- ç¡®è®¤æ–°ç´¢å¼•èƒ½è¦†ç›–æ—§ç´¢å¼•çš„æ‰€æœ‰åœºæ™¯åå†åˆ é™¤
DROP INDEX idx_name_email ON users;
```

---

## 6. ğŸ¤– è¦†ç›–ç´¢å¼•è®¾è®¡è‡ªåŠ¨åŒ–


### 6.1 è¦†ç›–ç´¢å¼•æ™ºèƒ½è®¾è®¡ç®—æ³•


**ğŸ§  è‡ªåŠ¨è®¾è®¡çš„æ ¸å¿ƒæ€è·¯**

```
ç®—æ³•è¾“å…¥ï¼š
â€¢ å†å²æŸ¥è¯¢æ—¥å¿—ï¼ˆæ…¢æŸ¥è¯¢æ—¥å¿—ã€general logï¼‰
â€¢ æŸ¥è¯¢é¢‘ç‡ç»Ÿè®¡
â€¢ è¡¨ç»“æ„ä¿¡æ¯
â€¢ ç°æœ‰ç´¢å¼•æƒ…å†µ

ç®—æ³•å¤„ç†ï¼š
1. SQLè§£æ â†’ æå–WHEREã€SELECTå­—æ®µ
2. é¢‘ç‡ç»Ÿè®¡ â†’ è¯†åˆ«é«˜é¢‘æŸ¥è¯¢æ¨¡å¼
3. å­—æ®µåˆ†æ â†’ è¯„ä¼°å­—æ®µç‰¹å¾å’Œæˆæœ¬
4. ç»„åˆä¼˜åŒ– â†’ ç”Ÿæˆæœ€ä¼˜ç´¢å¼•è®¾è®¡æ–¹æ¡ˆ
5. æ”¶ç›Šè¯„ä¼° â†’ é¢„æµ‹æ€§èƒ½æå‡æ•ˆæœ

ç®—æ³•è¾“å‡ºï¼š
â€¢ æ¨èçš„è¦†ç›–ç´¢å¼•DDLè¯­å¥
â€¢ æ€§èƒ½æå‡é¢„ä¼°
â€¢ å­˜å‚¨æˆæœ¬è¯„ä¼°
â€¢ å®æ–½ä¼˜å…ˆçº§æ’åº
```

**ğŸ’» è‡ªåŠ¨åŒ–è®¾è®¡å·¥å…·å®ç°æ€è·¯**

```python
# è¦†ç›–ç´¢å¼•è®¾è®¡è‡ªåŠ¨åŒ–å·¥å…·ä¼ªä»£ç 
class CoveringIndexDesigner:
    
    def analyze_query_patterns(self, slow_log_file):
        """åˆ†ææŸ¥è¯¢æ¨¡å¼ï¼Œè¯†åˆ«é«˜é¢‘æŸ¥è¯¢"""
        patterns = {}
        
        for query in self.parse_slow_log(slow_log_file):
            # æå–SELECTå­—æ®µå’ŒWHEREæ¡ä»¶
            select_fields = self.extract_select_fields(query)
            where_fields = self.extract_where_fields(query)
            
            pattern_key = (tuple(where_fields), tuple(select_fields))
            patterns[pattern_key] = patterns.get(pattern_key, 0) + 1
            
        return sorted(patterns.items(), key=lambda x: x[1], reverse=True)
    
    def design_covering_index(self, table_name, query_patterns):
        """è®¾è®¡è¦†ç›–ç´¢å¼•"""
        recommendations = []
        
        for pattern, frequency in query_patterns[:10]:  # å–top10é«˜é¢‘æ¨¡å¼
            where_fields, select_fields = pattern
            
            # è®¡ç®—ç´¢å¼•å­—æ®µç»„åˆ
            index_fields = self.optimize_field_order(
                where_fields + select_fields
            )
            
            # è¯„ä¼°ç´¢å¼•ä»·å€¼
            cost_benefit = self.calculate_cost_benefit(
                table_name, index_fields, frequency
            )
            
            if cost_benefit['roi'] > 2.0:  # ROI > 2æ‰æ¨è
                recommendations.append({
                    'index_name': f'idx_{table_name}_covering_{len(recommendations)}',
                    'fields': index_fields,
                    'ddl': self.generate_ddl(table_name, index_fields),
                    'estimated_improvement': cost_benefit['performance_gain'],
                    'storage_cost': cost_benefit['storage_mb']
                })
                
        return recommendations
```

### 6.2 è¦†ç›–ç´¢å¼•è®¾è®¡å†³ç­–æ ‘


**ğŸŒ³ è‡ªåŠ¨åŒ–å†³ç­–æµç¨‹**

```
æŸ¥è¯¢åˆ†æ
    â”‚
    â”œâ”€ æŸ¥è¯¢é¢‘ç‡ > 1000æ¬¡/å¤©ï¼Ÿ
    â”‚   â”œâ”€ Yes â†’ ç»§ç»­è¯„ä¼°
    â”‚   â””â”€ No â†’ è·³è¿‡
    â”‚
    â”œâ”€ SELECTå­—æ®µæ•° < 10ä¸ªï¼Ÿ
    â”‚   â”œâ”€ Yes â†’ ç»§ç»­è¯„ä¼°  
    â”‚   â””â”€ No â†’ è€ƒè™‘éƒ¨åˆ†è¦†ç›–
    â”‚
    â”œâ”€ å­—æ®µæ€»å¤§å° < 100å­—èŠ‚ï¼Ÿ
    â”‚   â”œâ”€ Yes â†’ æ¨èåˆ›å»ºè¦†ç›–ç´¢å¼•
    â”‚   â””â”€ No â†’ è¯„ä¼°æ ¸å¿ƒå­—æ®µè¦†ç›–
    â”‚
    â”œâ”€ é¢„ä¼°æ€§èƒ½æå‡ > 30%ï¼Ÿ
    â”‚   â”œâ”€ Yes â†’ é«˜ä¼˜å…ˆçº§åˆ›å»º
    â”‚   â””â”€ No â†’ ä½ä¼˜å…ˆçº§æˆ–ä¸åˆ›å»º
    â”‚
    â””â”€ å­˜å‚¨æˆæœ¬ < æŸ¥è¯¢æ€§èƒ½æ”¶ç›Šï¼Ÿ
        â”œâ”€ Yes â†’ ç¡®è®¤åˆ›å»º
        â””â”€ No â†’ æ”¾å¼ƒåˆ›å»º
```

### 6.3 åŠ¨æ€è¦†ç›–ç´¢å¼•è°ƒæ•´æœºåˆ¶


**ğŸ”„ è‡ªé€‚åº”ç´¢å¼•ç®¡ç†**

```sql
-- åŠ¨æ€ç›‘æ§è„šæœ¬
DELIMITER $$
CREATE PROCEDURE monitor_covering_indexes()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE idx_name VARCHAR(100);
    DECLARE usage_count INT;
    DECLARE avg_cost DECIMAL(10,2);
    
    -- æ¸¸æ ‡å®šä¹‰
    DECLARE index_cursor CURSOR FOR
        SELECT 
            INDEX_NAME,
            COUNT_READ,
            ROUND(SUM_TIMER_READ/COUNT_READ/1000000, 2)
        FROM performance_schema.table_io_waits_summary_by_index_usage
        WHERE OBJECT_NAME = 'users' 
          AND COUNT_READ > 0;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    -- åˆ›å»ºç›‘æ§ç»“æœè¡¨
    CREATE TEMPORARY TABLE index_monitor_result (
        index_name VARCHAR(100),
        usage_count INT,
        avg_cost_ms DECIMAL(10,2),
        recommendation VARCHAR(200)
    );
    
    OPEN index_cursor;
    read_loop: LOOP
        FETCH index_cursor INTO idx_name, usage_count, avg_cost;
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- è¯„ä¼°é€»è¾‘
        SET @recommendation = CASE
            WHEN usage_count < 100 AND avg_cost > 10 THEN 'Consider dropping'
            WHEN usage_count > 10000 AND avg_cost < 1 THEN 'High value index'
            WHEN usage_count BETWEEN 100 AND 1000 THEN 'Monitor usage trend'
            ELSE 'Normal'
        END;
        
        INSERT INTO index_monitor_result VALUES(idx_name, usage_count, avg_cost, @recommendation);
    END LOOP;
    
    CLOSE index_cursor;
    
    -- è¾“å‡ºç›‘æ§ç»“æœ
    SELECT * FROM index_monitor_result ORDER BY usage_count DESC;
    
    DROP TEMPORARY TABLE index_monitor_result;
END$$
DELIMITER ;

-- å®šæœŸæ‰§è¡Œç›‘æ§
CALL monitor_covering_indexes();
```

---

## 7. ğŸ’° è¦†ç›–ç´¢å¼•æˆæœ¬æ”¶ç›Šåˆ†æ


### 7.1 å­˜å‚¨æˆæœ¬è®¡ç®—


**ğŸ“Š ç´¢å¼•å­˜å‚¨å¼€é”€åˆ†æ**

```
ç´¢å¼•å¤§å°è®¡ç®—å…¬å¼ï¼š
ç´¢å¼•å¤§å° = è¡Œæ•° Ã— (ç´¢å¼•å­—æ®µæ€»é•¿åº¦ + ç´¢å¼•å¼€é”€)

å…·ä½“è®¡ç®—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨åŸºæœ¬ä¿¡æ¯          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¡¨è¡Œæ•°ï¼š1,000,000   â”‚
â”‚ å¹³å‡è¡Œå¤§å°ï¼š200å­—èŠ‚  â”‚
â”‚ è¡¨æ€»å¤§å°ï¼š200MB     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¦†ç›–ç´¢å¼•è®¾è®¡ï¼š
å­—æ®µï¼šstatus(1) + name(50) + email(100) + id(4) = 155å­—èŠ‚
ç´¢å¼•å¼€é”€ï¼šçº¦20å­—èŠ‚ï¼ˆæŒ‡é’ˆã€å…ƒæ•°æ®ç­‰ï¼‰
å•è¡Œç´¢å¼•å¤§å°ï¼š175å­—èŠ‚

ç´¢å¼•æ€»å¤§å°ï¼š
1,000,000 Ã— 175å­—èŠ‚ = 175MB

å­˜å‚¨æˆæœ¬è¯„ä¼°ï¼š
â€¢ ç´¢å¼•å¤§å°å‡ ä¹ç­‰äºè¡¨å¤§å°
â€¢ å­˜å‚¨æˆæœ¬å¢åŠ 87.5%
â€¢ éœ€è¦æƒè¡¡æ€§èƒ½æ”¶ç›Š
```

### 7.2 æ€§èƒ½æ”¶ç›Šé‡åŒ–


**âš¡ æ€§èƒ½æ”¶ç›Šè®¡ç®—æ¨¡å‹**

```sql
-- æ€§èƒ½åŸºå‡†æµ‹è¯•
SET @start_time = NOW(6);

-- æµ‹è¯•æ™®é€šç´¢å¼•æ€§èƒ½
SELECT id, username, email, register_time 
FROM users_large 
WHERE status = 1 
LIMIT 1000;

SET @end_time = NOW(6);
SET @normal_index_time = TIMESTAMPDIFF(MICROSECOND, @start_time, @end_time);

-- æµ‹è¯•è¦†ç›–ç´¢å¼•æ€§èƒ½  
SET @start_time = NOW(6);

SELECT id, username, email, register_time 
FROM users_large 
WHERE status = 1 
LIMIT 1000;

SET @end_time = NOW(6);
SET @covering_index_time = TIMESTAMPDIFF(MICROSECOND, @start_time, @end_time);

-- è®¡ç®—æ€§èƒ½æå‡
SELECT 
    @normal_index_time as normal_time_us,
    @covering_index_time as covering_time_us,
    ROUND((@normal_index_time - @covering_index_time) * 100.0 / @normal_index_time, 2) as improvement_percent,
    ROUND(@normal_index_time / @covering_index_time, 2) as speed_ratio;
```

### 7.3 æŠ•èµ„å›æŠ¥ç‡(ROI)åˆ†æ


**ğŸ“ˆ ROIè®¡ç®—æ¡†æ¶**

```
æˆæœ¬è®¡ç®—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­˜å‚¨æˆæœ¬                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç£ç›˜ç©ºé—´ï¼š175MB Ã— $0.1/GB â”‚
â”‚ â€¢ å†…å­˜ç¼“å­˜ï¼šé¢å¤–25%å†…å­˜éœ€æ±‚  â”‚
â”‚ â€¢ ç»´æŠ¤å¼€é”€ï¼šå†™å…¥æ€§èƒ½ä¸‹é™5%   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ”¶ç›Šè®¡ç®—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€§èƒ½æ”¶ç›Š                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ â€¢ æŸ¥è¯¢æ€§èƒ½æå‡ï¼š70%         â”‚
â”‚ â€¢ å¹¶å‘èƒ½åŠ›æå‡ï¼š40%         â”‚
â”‚ â€¢ ç³»ç»Ÿå“åº”æ—¶é—´ï¼š-60%        â”‚
â”‚ â€¢ ç”¨æˆ·ä½“éªŒæ”¹å–„ï¼šæ˜¾è‘—         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ROI = (æ€§èƒ½æ”¶ç›Šä»·å€¼ - å­˜å‚¨æˆæœ¬) / å­˜å‚¨æˆæœ¬

ç¤ºä¾‹è®¡ç®—ï¼š
é«˜é¢‘æŸ¥è¯¢æ¯å¤©10ä¸‡æ¬¡ï¼Œå¹³å‡æå‡70ms
èŠ‚çœæ—¶é—´ï¼š10ä¸‡ Ã— 70ms = 7000ç§’/å¤©
æœåŠ¡å™¨æˆæœ¬èŠ‚çœï¼šçº¦$50/æœˆ
å­˜å‚¨æˆæœ¬å¢åŠ ï¼šçº¦$15/æœˆ
ROI = ($50 - $15) / $15 = 233%
```

### 7.4 è¦†ç›–ç´¢å¼•æ”¶ç›Šæœ€å¤§åŒ–ç­–ç•¥


**ğŸ¯ æœ€å¤§åŒ–æ”¶ç›Šçš„è®¾è®¡åŸåˆ™**

```
ç­–ç•¥1ï¼šé«˜é¢‘ä¼˜å…ˆ
â€¢ ä¼˜å…ˆä¸ºè®¿é—®é¢‘ç‡æœ€é«˜çš„æŸ¥è¯¢åˆ›å»ºè¦†ç›–ç´¢å¼•
â€¢ 80/20åŸåˆ™ï¼š20%çš„æŸ¥è¯¢æ¶ˆè€—80%çš„èµ„æº

ç­–ç•¥2ï¼šæ¸è¿›å¼å®æ–½
ç¬¬ä¸€é˜¶æ®µï¼šä¸ºæœ€æ ¸å¿ƒçš„3-5ä¸ªæŸ¥è¯¢åˆ›å»ºè¦†ç›–ç´¢å¼•
ç¬¬äºŒé˜¶æ®µï¼šç›‘æ§æ•ˆæœï¼Œé€æ­¥æ‰©å±•
ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–è°ƒæ•´ï¼Œåˆ é™¤ä½æ•ˆç´¢å¼•

ç­–ç•¥3ï¼šç»„åˆç´¢å¼•é‡ç”¨
â€¢ è®¾è®¡æ—¶è€ƒè™‘ç´¢å¼•å‰ç¼€åŒ¹é…
â€¢ ä¸€ä¸ªè¦†ç›–ç´¢å¼•å°½é‡æ»¡è¶³å¤šä¸ªæŸ¥è¯¢æ¨¡å¼
â€¢ é¿å…è¿‡å¤šç›¸ä¼¼çš„ç´¢å¼•

ç­–ç•¥4ï¼šä¸šåŠ¡åœºæ™¯èšç„¦
â€¢ ä¸ºæ ¸å¿ƒä¸šåŠ¡æµç¨‹è®¾è®¡ä¸“é—¨çš„è¦†ç›–ç´¢å¼•
â€¢ ç™»å½•éªŒè¯ã€è®¢å•æŸ¥è¯¢ã€æ”¯ä»˜æµç¨‹ç­‰
â€¢ è¾¹ç¼˜åŠŸèƒ½å¯ä»¥ä½¿ç”¨æ™®é€šç´¢å¼•
```

---

## 8. ğŸ” è¦†ç›–ç´¢å¼•é€‚ç”¨åœºæ™¯è¯„ä¼°æ¨¡å‹


### 8.1 åœºæ™¯é€‚ç”¨æ€§è¯„åˆ†æ¨¡å‹


**ğŸ“‹ è¯„ä¼°ç»´åº¦ä¸æƒé‡**

```
è¯„ä¼°æ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»´åº¦1ï¼šæŸ¥è¯¢é¢‘ç‡ (æƒé‡40%)    â”‚
â”‚ â€¢ é«˜é¢‘(>1000æ¬¡/å°æ—¶)ï¼š10åˆ†  â”‚
â”‚ â€¢ ä¸­é¢‘(100-1000æ¬¡/å°æ—¶)ï¼š6åˆ†â”‚
â”‚ â€¢ ä½é¢‘(<100æ¬¡/å°æ—¶)ï¼š2åˆ†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»´åº¦2ï¼šæ€§èƒ½æ•æ„Ÿåº¦ (æƒé‡30%)  â”‚
â”‚ â€¢ æ ¸å¿ƒä¸šåŠ¡è·¯å¾„ï¼š10åˆ†        â”‚
â”‚ â€¢ é‡è¦åŠŸèƒ½ï¼š7åˆ†             â”‚
â”‚ â€¢ ä¸€èˆ¬åŠŸèƒ½ï¼š4åˆ†             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»´åº¦3ï¼šå®ç°éš¾åº¦ (æƒé‡20%)    â”‚
â”‚ â€¢ å­—æ®µå°‘ä¸”ç®€å•ï¼š10åˆ†        â”‚
â”‚ â€¢ å­—æ®µé€‚ä¸­ï¼š7åˆ†             â”‚
â”‚ â€¢ å­—æ®µå¤šä¸”å¤æ‚ï¼š4åˆ†         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»´åº¦4ï¼šç»´æŠ¤æˆæœ¬ (æƒé‡10%)    â”‚
â”‚ â€¢ å¾ˆå°‘æ›´æ–°ï¼š10åˆ†            â”‚
â”‚ â€¢ å¶å°”æ›´æ–°ï¼š7åˆ†             â”‚
â”‚ â€¢ é¢‘ç¹æ›´æ–°ï¼š4åˆ†             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€»åˆ†è®¡ç®—ï¼š
æ€»åˆ† = Î£(ç»´åº¦å¾—åˆ† Ã— æƒé‡)
æ¨èæ ‡å‡†ï¼š
â€¢ 8åˆ†ä»¥ä¸Šï¼šå¼ºçƒˆæ¨è
â€¢ 6-8åˆ†ï¼šå»ºè®®åˆ›å»º
â€¢ 4-6åˆ†ï¼šè°¨æ…è¯„ä¼°
â€¢ 4åˆ†ä»¥ä¸‹ï¼šä¸æ¨è
```

### 8.2 è¦†ç›–ç´¢å¼•è®¾è®¡å†³ç­–å·¥å…·


**ğŸ› ï¸ å†³ç­–æ”¯æŒç³»ç»Ÿ**

```sql
-- åˆ›å»ºç´¢å¼•è¯„ä¼°å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE evaluate_covering_index(
    IN table_name VARCHAR(100),
    IN query_frequency INT,
    IN field_list VARCHAR(500),
    OUT recommendation VARCHAR(200),
    OUT estimated_benefit DECIMAL(10,2)
)
BEGIN
    DECLARE field_count INT;
    DECLARE avg_field_size INT;
    DECLARE table_size_mb DECIMAL(10,2);
    DECLARE current_performance DECIMAL(10,2);
    
    -- è·å–è¡¨åŸºæœ¬ä¿¡æ¯
    SELECT 
        ROUND(DATA_LENGTH/1024/1024, 2),
        AVG_ROW_LENGTH
    INTO table_size_mb, avg_field_size
    FROM information_schema.TABLES 
    WHERE TABLE_NAME = table_name;
    
    -- è®¡ç®—å­—æ®µæ•°é‡
    SET field_count = (LENGTH(field_list) - LENGTH(REPLACE(field_list, ',', '')) + 1);
    
    -- è¯„ä¼°é€»è¾‘
    CASE 
        WHEN query_frequency > 1000 AND field_count <= 5 THEN
            SET recommendation = 'Highly Recommended';
            SET estimated_benefit = 70.0;
            
        WHEN query_frequency > 100 AND field_count <= 8 THEN
            SET recommendation = 'Recommended';
            SET estimated_benefit = 45.0;
            
        WHEN query_frequency < 50 OR field_count > 10 THEN
            SET recommendation = 'Not Recommended';
            SET estimated_benefit = 0.0;
            
        ELSE
            SET recommendation = 'Consider Carefully';
            SET estimated_benefit = 25.0;
    END CASE;
    
    -- è¾“å‡ºç»“æœ
    SELECT 
        recommendation as 'Recommendation',
        estimated_benefit as 'Estimated Performance Gain (%)',
        ROUND(field_count * avg_field_size * table_size_mb / 1000, 2) as 'Estimated Index Size (MB)';
        
END$$
DELIMITER ;

-- ä½¿ç”¨ç¤ºä¾‹
CALL evaluate_covering_index('users', 5000, 'status,name,email,register_time', @rec, @benefit);
```

---

## 9. ğŸ“ˆ è¦†ç›–ç´¢å¼•é•¿æœŸç»´æŠ¤è§„åˆ’


### 9.1 ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­–ç•¥


**ğŸ”„ ç´¢å¼•ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ**

```
é˜¶æ®µ1ï¼šè§„åˆ’è®¾è®¡ (1-2å‘¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ æŸ¥è¯¢æ¨¡å¼åˆ†æ              â”‚
â”‚ â€¢ è¦†ç›–ç´¢å¼•è®¾è®¡              â”‚
â”‚ â€¢ æˆæœ¬æ”¶ç›Šè¯„ä¼°              â”‚
â”‚ â€¢ å®æ–½è®¡åˆ’åˆ¶å®š              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
é˜¶æ®µ2ï¼šåˆ›å»ºéƒ¨ç½² (1å‘¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ æµ‹è¯•ç¯å¢ƒéªŒè¯              â”‚
â”‚ â€¢ ç”Ÿäº§ç¯å¢ƒåˆ›å»º              â”‚
â”‚ â€¢ æ€§èƒ½ç›‘æ§å¯åŠ¨              â”‚
â”‚ â€¢ æ•ˆæœåˆæ­¥è¯„ä¼°              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
é˜¶æ®µ3ï¼šç›‘æ§ä¼˜åŒ– (æŒç»­)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ ä½¿ç”¨æƒ…å†µç›‘æ§              â”‚
â”‚ â€¢ æ€§èƒ½æ”¶ç›Šè·Ÿè¸ª              â”‚
â”‚ â€¢ é—®é¢˜è¯†åˆ«å¤„ç†              â”‚
â”‚ â€¢ ä¼˜åŒ–è°ƒæ•´å®æ–½              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
é˜¶æ®µ4ï¼šè¯„ä¼°è°ƒæ•´ (å­£åº¦)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ æ•´ä½“æ•ˆæœè¯„ä¼°              â”‚
â”‚ â€¢ ä¸šåŠ¡å˜åŒ–é€‚é…              â”‚
â”‚ â€¢ ç´¢å¼•ç»“æ„è°ƒæ•´              â”‚
â”‚ â€¢ ä¸‹æœŸè§„åˆ’åˆ¶å®š              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 è¦†ç›–ç´¢å¼•ç»´æŠ¤è‡ªåŠ¨åŒ–


**ğŸ¤– è‡ªåŠ¨åŒ–ç»´æŠ¤å·¥å…·è®¾è®¡**

```python
# è¦†ç›–ç´¢å¼•è‡ªåŠ¨ç»´æŠ¤ç³»ç»Ÿ
class CoveringIndexMaintainer:
    
    def __init__(self, db_config):
        self.db = Database(db_config)
        self.alert_thresholds = {
            'low_usage': 100,      # ä½ä½¿ç”¨ç‡é˜ˆå€¼
            'high_cost': 50,       # é«˜æˆæœ¬é˜ˆå€¼(ms)
            'roi_threshold': 1.5    # ROIé˜ˆå€¼
        }
    
    def daily_health_check(self):
        """æ¯æ—¥ç´¢å¼•å¥åº·æ£€æŸ¥"""
        results = []
        
        # æ£€æŸ¥ä½ä½¿ç”¨ç‡ç´¢å¼•
        low_usage_indexes = self.find_low_usage_indexes()
        for idx in low_usage_indexes:
            results.append({
                'type': 'low_usage',
                'index': idx['name'],
                'action': 'consider_dropping',
                'usage': idx['count'],
                'recommendation': f"Usage only {idx['count']} times in 24h"
            })
        
        # æ£€æŸ¥é«˜æˆæœ¬ç´¢å¼•
        high_cost_indexes = self.find_high_cost_indexes()
        for idx in high_cost_indexes:
            results.append({
                'type': 'high_cost', 
                'index': idx['name'],
                'action': 'optimize_structure',
                'cost': idx['avg_time'],
                'recommendation': f"Average cost {idx['avg_time']}ms is too high"
            })
            
        return results
    
    def auto_optimization_suggestions(self):
        """è‡ªåŠ¨ä¼˜åŒ–å»ºè®®"""
        suggestions = []
        
        # åˆ†ææŸ¥è¯¢æ—¥å¿—ï¼Œå‘ç°æ–°çš„è¦†ç›–ç´¢å¼•æœºä¼š
        query_patterns = self.analyze_recent_queries()
        
        for pattern in query_patterns:
            if pattern['frequency'] > 1000 and pattern['improvement_potential'] > 0.3:
                suggestions.append({
                    'type': 'new_covering_index',
                    'query_pattern': pattern['template'],
                    'suggested_fields': pattern['optimal_fields'],
                    'estimated_benefit': f"{pattern['improvement_potential']*100}%"
                })
        
        return suggestions
```

### 9.3 è¦†ç›–ç´¢å¼•è§„åˆ’æœ€ä½³å®è·µ


**ğŸ† ä¼ä¸šçº§æœ€ä½³å®è·µ**

```
ğŸ”¸ è§„åˆ’åŸåˆ™
1. ä¸šåŠ¡é©±åŠ¨ï¼šåŸºäºæ ¸å¿ƒä¸šåŠ¡æŸ¥è¯¢æ¨¡å¼è®¾è®¡
2. æ¸è¿›å®æ–½ï¼šå…ˆåšæ ¸å¿ƒåœºæ™¯ï¼Œå†æ‰©å±•è¾¹ç¼˜åœºæ™¯  
3. æŒç»­ä¼˜åŒ–ï¼šå®šæœŸè¯„ä¼°ï¼ŒåŠ¨æ€è°ƒæ•´
4. æˆæœ¬æ§åˆ¶ï¼šç¡®ä¿æŠ•å…¥äº§å‡ºæ¯”åˆç†

ğŸ”¸ å®æ–½æµç¨‹
ç¬¬1æ­¥ï¼šä¸šåŠ¡æŸ¥è¯¢å®¡è®¡
â€¢ æ”¶é›†1-2å‘¨çš„æŸ¥è¯¢æ—¥å¿—
â€¢ ç»Ÿè®¡æŸ¥è¯¢é¢‘ç‡å’Œè€—æ—¶åˆ†å¸ƒ
â€¢ è¯†åˆ«æ€§èƒ½ç“¶é¢ˆæŸ¥è¯¢

ç¬¬2æ­¥ï¼šè¦†ç›–ç´¢å¼•è®¾è®¡
â€¢ æŒ‰ç…§é¢‘ç‡å’Œé‡è¦æ€§æ’åº
â€¢ è®¾è®¡5-10ä¸ªæ ¸å¿ƒè¦†ç›–ç´¢å¼•
â€¢ è¯„ä¼°å­˜å‚¨å’Œç»´æŠ¤æˆæœ¬

ç¬¬3æ­¥ï¼šåˆ†é˜¶æ®µå®æ–½
â€¢ å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ•ˆæœ
â€¢ é€ä¸ªåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
â€¢ ç›‘æ§éƒ¨ç½²åçš„æ€§èƒ½å˜åŒ–

ç¬¬4æ­¥ï¼šæ•ˆæœè¯„ä¼°ä¼˜åŒ–
â€¢ 2å‘¨åè¯„ä¼°å®é™…æ•ˆæœ
â€¢ è°ƒæ•´ä¸ç†æƒ³çš„ç´¢å¼•è®¾è®¡
â€¢ åˆ¶å®šä¸‹é˜¶æ®µä¼˜åŒ–è®¡åˆ’

ğŸ”¸ ç»´æŠ¤ç­–ç•¥
â€¢ æœˆåº¦æ£€æŸ¥ï¼šç´¢å¼•ä½¿ç”¨ç‡ã€æ€§èƒ½æ”¶ç›Š
â€¢ å­£åº¦è¯„ä¼°ï¼šROIåˆ†æã€ä¸šåŠ¡é€‚é…æ€§
â€¢ å¹´åº¦è§„åˆ’ï¼šæ•´ä½“ç´¢å¼•ç­–ç•¥è°ƒæ•´
â€¢ å¼‚å¸¸å¤„ç†ï¼šç›‘æ§å‘Šè­¦ã€å¿«é€Ÿå“åº”
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 è¦†ç›–ç´¢å¼•æ ¸å¿ƒä»·å€¼


> ğŸ“Œ **æ ¸å¿ƒç†è§£**  
> è¦†ç›–ç´¢å¼•çš„æœ¬è´¨æ˜¯æŠŠ"æŸ¥è¯¢éœ€è¦çš„æ•°æ®"æå‰å‡†å¤‡å¥½æ”¾åœ¨ç´¢å¼•é‡Œï¼Œå°±åƒæŠŠå¸¸ç”¨ä¸œè¥¿æ”¾åœ¨æ¡Œé¢ä¸Šï¼Œä¸ç”¨å»æŠ½å±‰é‡Œç¿»æ‰¾

**ğŸ”¹ æ ¸å¿ƒä¼˜åŠ¿**
```
æ€§èƒ½æå‡ï¼š
â€¢ é¿å…å›è¡¨æ“ä½œï¼Œå‡å°‘50-80%çš„IO
â€¢ é™ä½é”ç«äº‰ï¼Œæå‡å¹¶å‘æ€§èƒ½
â€¢ å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œæé«˜ç¼“å­˜æ•ˆç‡

ä¸šåŠ¡ä»·å€¼ï¼š
â€¢ æ”¹å–„ç”¨æˆ·ä½“éªŒï¼Œé¡µé¢åŠ è½½æ›´å¿«
â€¢ æå‡ç³»ç»Ÿå¹¶å‘èƒ½åŠ›
â€¢ é™ä½æœåŠ¡å™¨è´Ÿè½½å’Œæˆæœ¬
```

### 10.2 è®¾è®¡è¦ç‚¹é€Ÿè®°


**ğŸ¯ è®¾è®¡è®°å¿†è¦ç‚¹**
```
é€‰æ‹©æ ‡å‡†ï¼š
â€¢ é«˜é¢‘æŸ¥è¯¢ä¼˜å…ˆ (>1000æ¬¡/å¤©)
â€¢ å­—æ®µæ•°é‡é€‚ä¸­ (<10ä¸ªå­—æ®µ)
â€¢ å­—æ®µå¤§å°å¯æ§ (<100å­—èŠ‚)
â€¢ ä¸šåŠ¡é‡è¦æ€§é«˜

å­—æ®µé¡ºåºï¼š
WHEREå­—æ®µ â†’ ORDER BYå­—æ®µ â†’ SELECTå­—æ®µ
ç­‰å€¼æ¡ä»¶ â†’ èŒƒå›´æ¡ä»¶ â†’ è¿”å›å­—æ®µ

é¿å…è¯¯åŒºï¼š
âŒ ä¸è¦ä¸ºæ‰€æœ‰æŸ¥è¯¢éƒ½åˆ›å»ºè¦†ç›–ç´¢å¼•
âŒ ä¸è¦åŒ…å«è¿‡å¤šå­—æ®µ
âŒ ä¸è¦å¿½ç•¥ç»´æŠ¤æˆæœ¬
âŒ ä¸è¦ä¸€æˆä¸å˜ï¼Œè¦åŠ¨æ€è°ƒæ•´
```

### 10.3 å®æ–½å»ºè®®


**ğŸ’¡ å®é™…æ“ä½œå»ºè®®**

```
ğŸ”¸ æ–°é¡¹ç›®å»ºè®®
â€¢ åœ¨ç³»ç»Ÿè®¾è®¡é˜¶æ®µå°±è€ƒè™‘è¦†ç›–ç´¢å¼•
â€¢ ä¸ºæ ¸å¿ƒä¸šåŠ¡æµç¨‹é¢„è®¾è¦†ç›–ç´¢å¼•
â€¢ å»ºç«‹ç´¢å¼•è®¾è®¡reviewæœºåˆ¶

ğŸ”¸ ç°æœ‰ç³»ç»Ÿä¼˜åŒ–
â€¢ å…ˆåˆ†æç°æœ‰æ€§èƒ½ç“¶é¢ˆ
â€¢ è¯†åˆ«é«˜ä»·å€¼çš„ä¼˜åŒ–æœºä¼š
â€¢ åˆ¶å®šåˆ†é˜¶æ®µå®æ–½è®¡åˆ’
â€¢ å»ºç«‹æ•ˆæœè¯„ä¼°æœºåˆ¶

ğŸ”¸ å›¢é˜Ÿåä½œ
â€¢ DBAè´Ÿè´£æŠ€æœ¯å®æ–½å’Œç›‘æ§
â€¢ å¼€å‘äººå‘˜æä¾›æŸ¥è¯¢æ¨¡å¼åˆ†æ
â€¢ ä¸šåŠ¡äººå‘˜ç¡®å®šä¼˜å…ˆçº§
â€¢ è¿ç»´äººå‘˜ç›‘æ§ç³»ç»Ÿå½±å“

ğŸ”¸ é£é™©æ§åˆ¶
â€¢ åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
â€¢ ç”Ÿäº§ç¯å¢ƒåˆ†æ‰¹éƒ¨ç½²
â€¢ å‡†å¤‡å›æ»šæ–¹æ¡ˆ
â€¢ å»ºç«‹ç›‘æ§å‘Šè­¦æœºåˆ¶
```

### 10.4 å­¦ä¹ æ£€éªŒ


**âœ… æŒæ¡ç¨‹åº¦è‡ªæ£€**
- [ ] èƒ½è§£é‡Šè¦†ç›–ç´¢å¼•é¿å…å›è¡¨çš„åŸç†
- [ ] ä¼šåˆ†æå“ªäº›æŸ¥è¯¢é€‚åˆåˆ›å»ºè¦†ç›–ç´¢å¼•
- [ ] èƒ½è®¾è®¡åˆç†çš„è¦†ç›–ç´¢å¼•å­—æ®µç»„åˆ
- [ ] æ‡‚å¾—è¯„ä¼°è¦†ç›–ç´¢å¼•çš„æˆæœ¬ä¸æ”¶ç›Š
- [ ] ä¼šç›‘æ§è¦†ç›–ç´¢å¼•çš„ä½¿ç”¨æ•ˆæœ
- [ ] èƒ½åˆ¶å®šè¦†ç›–ç´¢å¼•çš„ç»´æŠ¤ç­–ç•¥

**ğŸ¯ å®è·µå»ºè®®**
1. åœ¨æµ‹è¯•ç¯å¢ƒåˆ›å»ºç¤ºä¾‹è¡¨ï¼Œç»ƒä¹ è¦†ç›–ç´¢å¼•è®¾è®¡
2. ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢æ˜¯å¦ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•
3. å¯¹æ¯”åˆ›å»ºè¦†ç›–ç´¢å¼•å‰åçš„æ€§èƒ½å·®å¼‚
4. ç»ƒä¹ åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè¯†åˆ«è¦†ç›–ç´¢å¼•æœºä¼š

**æ ¸å¿ƒè®°å¿†**ï¼š
- è¦†ç›–ç´¢å¼• = ç´¢å¼•é‡ŒåŒ…å«æŸ¥è¯¢æ‰€éœ€çš„å…¨éƒ¨å­—æ®µ
- æ ¸å¿ƒä»·å€¼ = é¿å…å›è¡¨æ“ä½œï¼Œå¤§å¹…æå‡æŸ¥è¯¢æ€§èƒ½
- è®¾è®¡åŸåˆ™ = é«˜é¢‘æŸ¥è¯¢ä¼˜å…ˆï¼Œå­—æ®µç»„åˆåˆç†ï¼Œæˆæœ¬å¯æ§
- ç»´æŠ¤ç­–ç•¥ = æŒç»­ç›‘æ§ï¼ŒåŠ¨æ€è°ƒæ•´ï¼Œç¡®ä¿é•¿æœŸæ•ˆæœ