---
title: 18ã€ç´¢å¼•ä¸ç¼“å†²æ± äº¤äº’æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [ç´¢å¼•ä¸ç¼“å†²æ± åŸºæœ¬æ¦‚å¿µ](#1-ç´¢å¼•ä¸ç¼“å†²æ± åŸºæœ¬æ¦‚å¿µ)
2. [ç´¢å¼•é¡µé¢LRUç®—æ³•æœºåˆ¶](#2-ç´¢å¼•é¡µé¢LRUç®—æ³•æœºåˆ¶)
3. [ç´¢å¼•é¡µé¢é¢„è¯»ç­–ç•¥](#3-ç´¢å¼•é¡µé¢é¢„è¯»ç­–ç•¥)
4. [ç´¢å¼•é¡µé¢åŠ è½½ä¸æ›¿æ¢](#4-ç´¢å¼•é¡µé¢åŠ è½½ä¸æ›¿æ¢)
5. [è„é¡µåˆ·æ–°ä¼˜å…ˆçº§ç®¡ç†](#5-è„é¡µåˆ·æ–°ä¼˜å…ˆçº§ç®¡ç†)
6. [ç¼“å†²æ± å‘½ä¸­ç‡ä¼˜åŒ–](#6-ç¼“å†²æ± å‘½ä¸­ç‡ä¼˜åŒ–)
7. [å†…å­˜è®¿é—®æ¨¡å¼ä¼˜åŒ–](#7-å†…å­˜è®¿é—®æ¨¡å¼ä¼˜åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ ç´¢å¼•ä¸ç¼“å†²æ± åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•ä¸ç¼“å†²æ± äº¤äº’


**ç®€å•ç†è§£**ï¼šç´¢å¼•ä¸ç¼“å†²æ± çš„äº¤äº’å°±åƒæ˜¯"**å›¾ä¹¦é¦†çš„å€Ÿé˜…ç³»ç»Ÿ**"ã€‚

```
å›¾ä¹¦é¦†å€Ÿé˜…ç³»ç»Ÿå¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    è¯»è€…     â”‚â—„â”€â”€â–ºâ”‚   å›¾ä¹¦ç®¡ç†å‘˜  â”‚  â† æŸ¥è¯¢è¯·æ±‚
â”‚ (æŸ¥è¯¢å¼•æ“)   â”‚    â”‚ (ç¼“å†²æ± ç®¡ç†)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜…è¯»åŒºåŸŸ    â”‚    â”‚   ä¹¦åº“åŒºåŸŸ   â”‚
â”‚ (å†…å­˜ä¸­çš„ç´¢å¼•) â”‚    â”‚ (ç£ç›˜ä¸Šçš„ç´¢å¼•) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å€Ÿé˜…æµç¨‹ï¼š
1. è¯»è€…è¦æ‰¾æŸæœ¬ä¹¦ â†’ æŸ¥è¯¢éœ€è¦æŸä¸ªç´¢å¼•é¡µ
2. ç®¡ç†å‘˜å…ˆæŸ¥é˜…è¯»åŒº â†’ æ£€æŸ¥é¡µé¢æ˜¯å¦åœ¨ç¼“å†²æ± 
3. å¦‚æœæœ‰å°±ç›´æ¥ç»™ â†’ ç¼“å†²æ± å‘½ä¸­ï¼Œç›´æ¥è¿”å›
4. å¦‚æœæ²¡æœ‰å»ä¹¦åº“å– â†’ ä»ç£ç›˜åŠ è½½åˆ°ç¼“å†²æ± 
5. é˜…è¯»åŒºæ»¡äº†è¦è¿˜ä¹¦ â†’ LRUç®—æ³•å†³å®šæ›¿æ¢å“ªä¸ªé¡µé¢
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **ğŸ¯ å‡å°‘ç£ç›˜IO**ï¼šæŠŠå¸¸ç”¨ç´¢å¼•é¡µé¢æ”¾åœ¨å†…å­˜ä¸­
- **âš¡ æå‡æŸ¥è¯¢é€Ÿåº¦**ï¼šå†…å­˜è®¿é—®æ¯”ç£ç›˜å¿«10000å€ä»¥ä¸Š
- **ğŸ§  æ™ºèƒ½ç®¡ç†**ï¼šé¢„æµ‹å“ªäº›é¡µé¢ä¼šè¢«ä½¿ç”¨
- **ğŸ’¾ å†…å­˜ä¼˜åŒ–**ï¼šæœ‰é™å†…å­˜ç©ºé—´çš„æœ€ä¼˜åˆ©ç”¨

### 1.2 ç¼“å†²æ± åœ¨ç´¢å¼•ç³»ç»Ÿä¸­çš„ä½ç½®


```
MySQLç´¢å¼•æŸ¥è¯¢å®Œæ•´æµç¨‹ï¼š

åº”ç”¨ç¨‹åº
    â†“ SQLæŸ¥è¯¢
æŸ¥è¯¢ä¼˜åŒ–å™¨
    â†“ é€‰æ‹©ç´¢å¼•
ç´¢å¼•è®¿é—®å±‚
    â†“ è¯·æ±‚é¡µé¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼“å†²æ± ç®¡ç†  â”‚ â† æ ¸å¿ƒäº¤äº’å±‚
â”‚  - LRUé˜Ÿåˆ—  â”‚
â”‚  - é¢„è¯»æœºåˆ¶  â”‚
â”‚  - è„é¡µç®¡ç†  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ ç¼ºé¡µæ—¶
å­˜å‚¨å¼•æ“
    â†“ ç£ç›˜IO
ç‰©ç†å­˜å‚¨
```

### 1.3 ç´¢å¼•é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸ


```
ç´¢å¼•é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼š

ç£ç›˜å­˜å‚¨ â†’ é¢„è¯»/æŒ‰éœ€åŠ è½½ â†’ ç¼“å†²æ±  â†’ LRUé˜Ÿåˆ— â†’ è€åŒ–/æ›¿æ¢ â†’ åˆ·å›ç£ç›˜
    â†‘                                                    â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è„é¡µåˆ·æ–°æœºåˆ¶ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”Ÿå‘½å‘¨æœŸè¯¦è§£ï¼š
1. ğŸ”„ åŠ è½½ï¼šä»ç£ç›˜è¯»å–åˆ°å†…å­˜
2. ğŸ“– ä½¿ç”¨ï¼šåœ¨å†…å­˜ä¸­è¢«æŸ¥è¯¢è®¿é—®
3. ğŸ“ ä¿®æ”¹ï¼šæ›´æ–°æ“ä½œäº§ç”Ÿè„é¡µ
4. â° è€åŒ–ï¼šé•¿æ—¶é—´æœªä½¿ç”¨ç§»åˆ°LRUå°¾éƒ¨
5. ğŸ’¾ åˆ·æ–°ï¼šè„é¡µå†™å›ç£ç›˜
6. ğŸ—‘ï¸ æ›¿æ¢ï¼šè¢«æ–°é¡µé¢æ›¿æ¢å‡ºå†…å­˜
```

---

## 2. ğŸ”„ ç´¢å¼•é¡µé¢LRUç®—æ³•æœºåˆ¶


### 2.1 ä»€ä¹ˆæ˜¯LRUç®—æ³•


**ç®€å•ç†è§£**ï¼šLRUï¼ˆLeast Recently Usedï¼‰å°±æ˜¯"**æœ€è¿‘æœ€å°‘ä½¿ç”¨**"ç®—æ³•ï¼Œåƒæ˜¯æ•´ç†æˆ¿é—´æ—¶æŠŠæœ€ä¹…ä¸ç”¨çš„ä¸œè¥¿å…ˆä¸¢æ‰ã€‚

```
ä¼ ç»ŸLRUæ¦‚å¿µï¼š
æœ€è¿‘ä½¿ç”¨ â†â†’ æœ€ä¹…æœªä½¿ç”¨
[A] [B] [C] [D] [E]
 â†‘               â†‘
æ–°é¡µé¢æ’å…¥è¿™é‡Œ     è€é¡µé¢ä»è¿™é‡Œæ·˜æ±°

é—®é¢˜ï¼šå…¨è¡¨æ‰«æä¼šå†²åˆ·æ‰çƒ­ç‚¹æ•°æ®ï¼
æ‰«æå¤§è¡¨æ—¶ï¼š[scan1] [scan2] [scan3] ... 
æŠŠåŸæ¥çš„çƒ­ç‚¹é¡µé¢Aã€Bã€Cå…¨éƒ¨æŒ¤å‡ºå»äº†
```

### 2.2 MySQLæ”¹è¿›çš„LRUç®—æ³•


**ğŸ”¸ åˆ†æ®µLRUè®¾è®¡**

MySQLä½¿ç”¨**æ”¹è¿›çš„åˆ†æ®µLRUç®—æ³•**ï¼ŒæŠŠLRUé˜Ÿåˆ—åˆ†æˆä¸¤ä¸ªåŒºåŸŸï¼š

```
MySQLæ”¹è¿›LRUé˜Ÿåˆ—ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† é˜Ÿåˆ—å¤´
â”‚                 â”‚
â”‚   New SubList   â”‚ â† çƒ­ç‚¹åŒºåŸŸï¼ˆ5/8ï¼‰
â”‚   (çƒ­ç‚¹é¡µé¢)     â”‚   - æœ€è¿‘è®¿é—®çš„é¡µé¢
â”‚                 â”‚   - é«˜é¢‘è®¿é—®é¡µé¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† midpointåˆ†ç•Œç‚¹
â”‚                 â”‚
â”‚   Old SubList   â”‚ â† å†·æ•°æ®åŒºåŸŸï¼ˆ3/8ï¼‰
â”‚   (å†·é¡µé¢)      â”‚   - æ–°è¯»å…¥çš„é¡µé¢
â”‚                 â”‚   - å‡†å¤‡æ·˜æ±°çš„é¡µé¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â† é˜Ÿåˆ—å°¾ï¼ˆæ·˜æ±°ç‚¹ï¼‰

æ¯”ä¾‹é…ç½®ï¼š
- innodb_old_blocks_pct = 37 (é»˜è®¤)
- NewåŒºå  5/8 â‰ˆ 62.5%
- OldåŒºå  3/8 â‰ˆ 37.5%
```

**ğŸ”¸ é¡µé¢æ™‹å‡æœºåˆ¶**

```
é¡µé¢æ™‹å‡æµç¨‹ï¼š

ç¬¬ä¸€æ¬¡è®¿é—®ï¼šç£ç›˜é¡µé¢ â†’ OldåŒºå¤´éƒ¨
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ New SubList â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 
           â”‚[æ–°é¡µé¢] Old â”‚ â† æ’å…¥è¿™é‡Œ
           â”‚      SubListâ”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç­‰å¾…æ—¶é—´ï¼šå¿…é¡»åœ¨OldåŒºåœç•™ > innodb_old_blocks_time (é»˜è®¤1000ms)

å†æ¬¡è®¿é—®ï¼šå¦‚æœæ»¡è¶³æ—¶é—´æ¡ä»¶ â†’ æ™‹å‡åˆ°NewåŒºå¤´éƒ¨
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚[é¡µé¢] New   â”‚ â† æ™‹å‡åˆ°è¿™é‡Œ
           â”‚    SubList  â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚   Old       â”‚
           â”‚  SubList    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 LRUç®—æ³•æ ¸å¿ƒå‚æ•°


**ğŸ”¹ é‡è¦é…ç½®å‚æ•°**

| å‚æ•°åç§° | é»˜è®¤å€¼ | ä½œç”¨ | è°ƒä¼˜å»ºè®® |
|----------|--------|------|----------|
| `innodb_old_blocks_pct` | 37 | OldåŒºå æ¯” | OLTPåœºæ™¯å¯è°ƒå°åˆ°20-25 |
| `innodb_old_blocks_time` | 1000ms | æ™‹å‡ç­‰å¾…æ—¶é—´ | æ‰«æå¤šå¯è°ƒå¤§åˆ°5000ms |
| `innodb_buffer_pool_size` | 128MB | ç¼“å†²æ± æ€»å¤§å° | å»ºè®®è®¾ä¸ºå†…å­˜çš„60-80% |

**ğŸ”¹ ç®—æ³•å·¥ä½œç¤ºä¾‹**

```sql
-- æŸ¥çœ‹å½“å‰LRUç›¸å…³çŠ¶æ€
SHOW ENGINE INNODB STATUS\G

-- åœ¨è¾“å‡ºä¸­å…³æ³¨è¿™äº›æŒ‡æ ‡ï¼š
-- Buffer pool hit rate: 999 / 1000  # å‘½ä¸­ç‡99.9%
-- Young-making rate: 0.00 Per second # æ™‹å‡åˆ°NewåŒºçš„é¢‘ç‡
-- Non-young-making rate: 0.00        # OldåŒºè®¿é—®ä½†æœªæ™‹å‡çš„é¢‘ç‡
```

---

## 3. ğŸ“– ç´¢å¼•é¡µé¢é¢„è¯»ç­–ç•¥


### 3.1 ä»€ä¹ˆæ˜¯é¢„è¯»ç­–ç•¥


**ç®€å•ç†è§£**ï¼šé¢„è¯»ç­–ç•¥å°±åƒ"**èªæ˜çš„å›¾ä¹¦ç®¡ç†å‘˜**"ï¼Œèƒ½é¢„æµ‹ä½ æ¥ä¸‹æ¥è¦çœ‹å“ªæœ¬ä¹¦ï¼Œæå‰å‡†å¤‡å¥½ã€‚

```
é¢„è¯»ç­–ç•¥å¯¹æ¯”ï¼š

è¢«åŠ¨æ¨¡å¼ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰ï¼š
ç”¨æˆ·ï¼šæˆ‘è¦ç¬¬100é¡µ
ç³»ç»Ÿï¼šå¥½çš„ï¼Œå»ç£ç›˜å–ç¬¬100é¡µ (ç­‰å¾…10ms)
ç”¨æˆ·ï¼šç°åœ¨æˆ‘è¦ç¬¬101é¡µ  
ç³»ç»Ÿï¼šå¥½çš„ï¼Œå†å»ç£ç›˜å–ç¬¬101é¡µ (åˆç­‰å¾…10ms)

ä¸»åŠ¨æ¨¡å¼ï¼ˆé¢„è¯»ç­–ç•¥ï¼‰ï¼š
ç”¨æˆ·ï¼šæˆ‘è¦ç¬¬100é¡µ
ç³»ç»Ÿï¼šç»™ä½ ç¬¬100é¡µï¼ŒåŒæ—¶é¢„è¯»101ã€102ã€103é¡µ
ç”¨æˆ·ï¼šç°åœ¨æˆ‘è¦ç¬¬101é¡µ
ç³»ç»Ÿï¼šå·²ç»å‡†å¤‡å¥½äº†ï¼(0msç­‰å¾…)
```

### 3.2 çº¿æ€§é¢„è¯»ï¼ˆLinear Read-Aheadï¼‰


**ğŸ”¸ çº¿æ€§é¢„è¯»å·¥ä½œæœºåˆ¶**

å½“é¡ºåºè®¿é—®æŸä¸ªåŒºï¼ˆextentï¼‰çš„é¡µé¢æ—¶ï¼Œç³»ç»Ÿä¼šé¢„æµ‹æ€§åœ°è¯»å–ä¸‹ä¸€ä¸ªåŒºçš„é¡µé¢ã€‚

```
çº¿æ€§é¢„è¯»è§¦å‘æ¡ä»¶ï¼š

åŒºï¼ˆExtentï¼‰ç»“æ„ï¼šæ¯ä¸ªåŒºåŒ…å«64ä¸ªè¿ç»­é¡µé¢
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ P1  â”‚ P2  â”‚ P3  â”‚ P4  â”‚ P5  â”‚ P6  â”‚ ... â”‚ P64 â”‚ åŒº1
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ P65 â”‚ P66 â”‚ P67 â”‚ P68 â”‚ P69 â”‚ P70 â”‚ ... â”‚P128 â”‚ åŒº2
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

è§¦å‘æ¡ä»¶ï¼š
1. é¡ºåºè®¿é—®åŒº1ä¸­çš„é¡µé¢
2. è®¿é—®çš„è¿ç»­é¡µé¢æ•° â‰¥ innodb_read_ahead_threshold (é»˜è®¤56)
3. è‡ªåŠ¨é¢„è¯»åŒº2çš„æ‰€æœ‰64ä¸ªé¡µé¢

é…ç½®å‚æ•°ï¼š
innodb_read_ahead_threshold = 56  # 0-64ä¹‹é—´
- è®¾ä¸º0ï¼šç¦ç”¨çº¿æ€§é¢„è¯»  
- è®¾ä¸º64ï¼šè®¿é—®å®Œæ•´ä¸ªåŒºæ‰é¢„è¯»
- é»˜è®¤56ï¼šè®¿é—®87.5%çš„é¡µé¢æ—¶é¢„è¯»
```

**ğŸ”¹ çº¿æ€§é¢„è¯»æ•ˆæœåˆ†æ**

```
åœºæ™¯åˆ†æï¼š

âœ… é€‚åˆåœºæ™¯ï¼š
- å…¨è¡¨æ‰«æï¼šSELECT * FROM large_table
- èŒƒå›´æŸ¥è¯¢ï¼šSELECT * FROM table WHERE id BETWEEN 1000 AND 2000
- ç´¢å¼•èŒƒå›´æ‰«æï¼šORDER BY id LIMIT 1000

âŒ ä¸é€‚åˆåœºæ™¯ï¼š  
- éšæœºè®¿é—®ï¼šSELECT * FROM table WHERE id IN (1,100,200,300)
- ç‚¹æŸ¥è¯¢ï¼šSELECT * FROM table WHERE id = 12345
- è·³è·ƒå¼è®¿é—®ï¼šæ¯éš”å¾ˆå¤šé¡µæ‰è®¿é—®ä¸€æ¬¡

æ€§èƒ½æå‡ï¼š
- é¡ºåºIOæ›¿ä»£éšæœºIO
- å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°
- æé«˜ç£ç›˜å¸¦å®½åˆ©ç”¨ç‡
```

### 3.3 éšæœºé¢„è¯»ï¼ˆRandom Read-Aheadï¼‰


**ğŸ”¸ éšæœºé¢„è¯»æœºåˆ¶**

å½“æŸä¸ªåŒºçš„å¤šä¸ªé¡µé¢åœ¨çŸ­æ—¶é—´å†…è¢«è®¿é—®æ—¶ï¼Œé¢„è¯»è¯¥åŒºå‰©ä½™çš„é¡µé¢ã€‚

```
éšæœºé¢„è¯»è§¦å‘æ¡ä»¶ï¼š

æ—¶é—´çª—å£å†…çš„è®¿é—®æ¨¡å¼ï¼š
åŒºå†…é¡µé¢ï¼š[P1][P2][P3]...[P20]...[P35]...[P50]...[P64]
è®¿é—®è®°å½•ï¼š  âœ“    âœ“    âœ“       âœ“       âœ“       âœ“

è§¦å‘æ¡ä»¶ï¼š
1. åœ¨ä¸€ä¸ªåŒºå†…æœ‰â‰¥13ä¸ªé¡µé¢å·²ç»åœ¨ç¼“å†²æ± ä¸­
2. è¿™äº›é¡µé¢æ˜¯æœ€è¿‘è¢«è®¿é—®çš„ï¼ˆåœ¨LRUé˜Ÿåˆ—å‰1/4éƒ¨åˆ†ï¼‰
3. è‡ªåŠ¨è¯»å–è¯¥åŒºå‰©ä½™çš„é¡µé¢

æ§åˆ¶å‚æ•°ï¼š
innodb_random_read_ahead = OFF  # é»˜è®¤å…³é—­
- ç°ä»£MySQLç‰ˆæœ¬é€šå¸¸å…³é—­éšæœºé¢„è¯»
- å› ä¸ºå¯èƒ½å¯¼è‡´æ— ç”¨çš„IOæ“ä½œ
```

### 3.4 é¢„è¯»ç­–ç•¥ä¼˜åŒ–


**ğŸ”¹ é¢„è¯»å‚æ•°è°ƒä¼˜**

```sql
-- æŸ¥çœ‹é¢„è¯»ç›¸å…³çŠ¶æ€
SHOW ENGINE INNODB STATUS\G

-- åœ¨è¾“å‡ºä¸­å…³æ³¨ï¼š
-- Pages read ahead 0.00/s      # é¢„è¯»é¡µé¢é€Ÿç‡
-- Pages evicted without access # é¢„è¯»ä½†æœªä½¿ç”¨å°±è¢«æ·˜æ±°çš„é¡µé¢
-- Pages made young 0.00/s      # OldåŒºæ™‹å‡NewåŒºçš„é€Ÿç‡

-- ä¼˜åŒ–å»ºè®®ï¼š
-- å¦‚æœ"Pages evicted without access"å¾ˆé«˜ï¼Œè¯´æ˜é¢„è¯»è¿‡åº¦
-- å¯ä»¥è°ƒå¤§innodb_read_ahead_thresholdå‚æ•°
SET GLOBAL innodb_read_ahead_threshold = 60;

-- å¦‚æœé¡ºåºæ‰«æå¾ˆå¤šï¼Œå¯ä»¥è°ƒå°ä»¥å¢åŠ é¢„è¯»
SET GLOBAL innodb_read_ahead_threshold = 32;
```

---

## 4. ğŸ”„ ç´¢å¼•é¡µé¢åŠ è½½ä¸æ›¿æ¢


### 4.1 ç´¢å¼•é¡µé¢åŠ è½½ç­–ç•¥


**ğŸ”¸ æŒ‰éœ€åŠ è½½æœºåˆ¶**

```
ç´¢å¼•é¡µé¢åŠ è½½æµç¨‹ï¼š

æŸ¥è¯¢è¯·æ±‚
    â†“
æ£€æŸ¥é¡µé¢æ˜¯å¦åœ¨ç¼“å†²æ± 
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¼“å†²æ± æŸ¥æ‰¾      â”‚
â”‚ - é€šè¿‡é¡µé¢IDæŸ¥æ‰¾ â”‚
â”‚ - å“ˆå¸Œè¡¨å¿«é€Ÿå®šä½ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“           â†“
 å‘½ä¸­(Hit)    ç¼ºå¤±(Miss)
    â†“           â†“
 è¿”å›é¡µé¢    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ ç£ç›˜IOåŠ è½½   â”‚
            â”‚ - è¯»å–é¡µé¢   â”‚
            â”‚ - æ”¾å…¥ç¼“å†²æ±  â”‚
            â”‚ - æ›´æ–°LRU   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
             è¿”å›é¡µé¢
```

**ğŸ”¹ é¡µé¢åŠ è½½ä¼˜åŒ–ç­–ç•¥**

```sql
-- ç›‘æ§é¡µé¢åŠ è½½æƒ…å†µ
SELECT 
  variable_name,
  variable_value
FROM performance_schema.global_status 
WHERE variable_name IN (
  'Innodb_buffer_pool_reads',      -- ä»ç£ç›˜è¯»å–çš„é¡µé¢æ•°
  'Innodb_buffer_pool_read_requests', -- æ€»çš„é¡µé¢è¯·æ±‚æ•°
  'Innodb_pages_read'               -- è¯»å–çš„é¡µé¢æ€»æ•°
);

-- è®¡ç®—ç¼“å†²æ± å‘½ä¸­ç‡
SELECT 
  ROUND(
    (1 - Innodb_buffer_pool_reads / Innodb_buffer_pool_read_requests) * 100, 
    2
  ) AS buffer_pool_hit_rate_percent;
```

### 4.2 é¡µé¢æ›¿æ¢ç®—æ³•


**ğŸ”¸ æ”¹è¿›LRUçš„é¡µé¢æ›¿æ¢**

```
é¡µé¢æ›¿æ¢å†³ç­–æµç¨‹ï¼š

éœ€è¦åŠ è½½æ–°é¡µé¢
    â†“
æ£€æŸ¥ç¼“å†²æ± æ˜¯å¦æœ‰ç©ºé—²ç©ºé—´
    â†“           â†“
 æœ‰ç©ºé—²       æ— ç©ºé—²
    â†“           â†“
 ç›´æ¥åŠ è½½    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ é€‰æ‹©æ›¿æ¢é¡µé¢  â”‚
            â”‚ - ä»OldåŒºå°¾éƒ¨ â”‚
            â”‚ - ä¼˜å…ˆé€‰è„é¡µ  â”‚
            â”‚ - LRUç®—æ³•    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
            æ£€æŸ¥æ˜¯å¦ä¸ºè„é¡µ
                â†“       â†“
             æ˜¯è„é¡µ   éè„é¡µ
                â†“       â†“
            åˆ·æ–°åˆ°ç£ç›˜  ç›´æ¥æ›¿æ¢
                â†“       â†“
            æ›¿æ¢æˆåŠŸ â† â”€â”€â”€â”€â”˜
                â†“
            åŠ è½½æ–°é¡µé¢
```

**ğŸ”¹ é¡µé¢æ›¿æ¢ä¼˜å…ˆçº§**

```
æ›¿æ¢ä¼˜å…ˆçº§æ’åºï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. ğŸŸ¢ OldåŒºçš„éè„é¡µé¢
   - æœ€å®¹æ˜“æ›¿æ¢ï¼Œæ— éœ€åˆ·ç›˜
   - å¯¹æ€§èƒ½å½±å“æœ€å°

2. ğŸŸ¡ OldåŒºçš„è„é¡µé¢
   - éœ€è¦å…ˆåˆ·æ–°åˆ°ç£ç›˜
   - ä½†ä¸ä¼šå½±å“çƒ­ç‚¹æ•°æ®

3. ğŸŸ  NewåŒºé•¿æ—¶é—´æœªè®¿é—®çš„éè„é¡µé¢  
   - é€æ¸è€åŒ–çš„é¡µé¢
   - æ›¿æ¢å½±å“ç›¸å¯¹è¾ƒå°

4. ğŸ”´ NewåŒºé•¿æ—¶é—´æœªè®¿é—®çš„è„é¡µé¢
   - æœ€åçš„é€‰æ‹©
   - éœ€è¦åˆ·ç›˜ä¸”å¯èƒ½è¿˜ä¼šè¢«è®¿é—®
```

### 4.3 é¡µé¢æ›¿æ¢æ€§èƒ½ä¼˜åŒ–


**ğŸ”¹ æ›¿æ¢ç®—æ³•è°ƒä¼˜å‚æ•°**

```sql
-- æŸ¥çœ‹é¡µé¢æ›¿æ¢ç›¸å…³ç»Ÿè®¡
SHOW ENGINE INNODB STATUS\G

-- å…³æ³¨æŒ‡æ ‡ï¼š
-- Free buffers: å‰©ä½™ç©ºé—²é¡µé¢æ•°
-- Database pages: å·²ä½¿ç”¨é¡µé¢æ•°  
-- Old database pages: OldåŒºé¡µé¢æ•°
-- Pending reads: ç­‰å¾…è¯»å–çš„é¡µé¢æ•°
-- Pending writes: ç­‰å¾…å†™å…¥çš„é¡µé¢æ•°

-- è°ƒä¼˜å»ºè®®ï¼š
-- 1. è°ƒæ•´OldåŒºæ¯”ä¾‹
SET GLOBAL innodb_old_blocks_pct = 25;  -- å‡å°‘åˆ°25%

-- 2. è°ƒæ•´æ™‹å‡ç­‰å¾…æ—¶é—´
SET GLOBAL innodb_old_blocks_time = 2000; -- å¢åŠ åˆ°2ç§’

-- 3. å¢åŠ ç¼“å†²æ± å¤§å°ï¼ˆé‡å¯åç”Ÿæ•ˆï¼‰
-- innodb_buffer_pool_size = 2G
```

---

## 5. ğŸ’¾ è„é¡µåˆ·æ–°ä¼˜å…ˆçº§ç®¡ç†


### 5.1 ä»€ä¹ˆæ˜¯è„é¡µåˆ·æ–°


**ç®€å•ç†è§£**ï¼šè„é¡µåˆ·æ–°å°±åƒæ˜¯"**å®šæœŸä¿å­˜æ–‡æ¡£**"ï¼ŒæŠŠå†…å­˜ä¸­ä¿®æ”¹è¿‡çš„æ•°æ®å†™å›ç£ç›˜ã€‚

```
è„é¡µäº§ç”Ÿå’Œåˆ·æ–°è¿‡ç¨‹ï¼š

åŸå§‹çŠ¶æ€ï¼šç£ç›˜é¡µé¢ = å†…å­˜é¡µé¢ï¼ˆä¸€è‡´ï¼‰
    â†“
æ‰§è¡ŒUPDATE/INSERT/DELETE
    â†“  
å†…å­˜é¡µé¢è¢«ä¿®æ”¹ï¼ˆäº§ç”Ÿè„é¡µï¼‰
ç£ç›˜é¡µé¢ â‰  å†…å­˜é¡µé¢ï¼ˆä¸ä¸€è‡´ï¼‰ â† è„é¡µçŠ¶æ€
    â†“
è§¦å‘è„é¡µåˆ·æ–°
    â†“
å†…å­˜é¡µé¢å†™å›ç£ç›˜
ç£ç›˜é¡µé¢ = å†…å­˜é¡µé¢ï¼ˆæ¢å¤ä¸€è‡´ï¼‰

è„é¡µåˆ·æ–°çš„å¿…è¦æ€§ï¼š
- ğŸ”’ äº‹åŠ¡æŒä¹…æ€§ï¼šä¿è¯å·²æäº¤äº‹åŠ¡ä¸ä¸¢å¤±
- ğŸ’¾ å†…å­˜å›æ”¶ï¼šè„é¡µåˆ·æ–°åæ‰èƒ½è¢«æ›¿æ¢
- âš¡ æ€§èƒ½ç¨³å®šï¼šé¿å…æ£€æŸ¥ç‚¹æ—¶å¤§é‡åˆ·æ–°
```

### 5.2 è„é¡µåˆ·æ–°è§¦å‘æ¡ä»¶


**ğŸ”¸ å¤šç§åˆ·æ–°è§¦å‘æœºåˆ¶**

```
è„é¡µåˆ·æ–°è§¦å‘æ¡ä»¶ï¼š

1. ğŸ”„ è‡ªé€‚åº”åˆ·æ–°ï¼ˆAdaptive Flushingï¼‰
   - æ ¹æ®é‡åšæ—¥å¿—äº§ç”Ÿé€Ÿåº¦è°ƒæ•´
   - ä¿æŒé‡åšæ—¥å¿—ç©ºé—´å……è¶³
   - innodb_adaptive_flushing = ON

2. â° å®šæœŸåˆ·æ–°ï¼ˆæ¯ç§’ä¸€æ¬¡ï¼‰
   - åå°çº¿ç¨‹å®šæœŸæ¸…ç†è„é¡µ
   - ç»´æŒä¸€å®šçš„è„é¡µæ¯”ä¾‹
   - innodb_max_dirty_pages_pct = 90%

3. ğŸš¨ å¼ºåˆ¶åˆ·æ–°ï¼ˆç¼“å†²æ± æ»¡ï¼‰
   - éœ€è¦æ›¿æ¢é¡µé¢æ—¶å‘ç°æ˜¯è„é¡µ
   - å¿…é¡»å…ˆåˆ·æ–°æ‰èƒ½æ›¿æ¢
   - å½±å“å‰å°æŸ¥è¯¢æ€§èƒ½

4. ğŸ“ æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰
   - å®šæœŸå°†æ‰€æœ‰è„é¡µåˆ·æ–°
   - ä¿è¯æ•°æ®ä¸€è‡´æ€§
   - å‡å°‘å´©æºƒæ¢å¤æ—¶é—´
```

### 5.3 è„é¡µåˆ·æ–°ä¼˜å…ˆçº§ç®—æ³•


**ğŸ”¸ åˆ·æ–°ä¼˜å…ˆçº§æ’åº**

```
è„é¡µåˆ·æ–°ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼šOldåŒºçš„è„é¡µ
   â”œâ”€ é•¿æ—¶é—´æœªè®¿é—®
   â”œâ”€ ä¸å¤ªå¯èƒ½å†è¢«ä½¿ç”¨  
   â””â”€ åˆ·æ–°åå¯ç«‹å³æ›¿æ¢

2. ğŸŸ  ä¸­ä¼˜å…ˆçº§ï¼šè„é¡µæ•°é‡è¾ƒå¤šçš„åŒº
   â”œâ”€ æ‰¹é‡åˆ·æ–°æ•ˆç‡é«˜
   â”œâ”€ è¿ç»­IOæ€§èƒ½å¥½
   â””â”€ å‡å°‘ç£ç›˜å¯»é“æ—¶é—´

3. ğŸŸ¡ ä½ä¼˜å…ˆçº§ï¼šNewåŒºçš„è„é¡µ
   â”œâ”€ å¯èƒ½è¿˜ä¼šè¢«è®¿é—®
   â”œâ”€ å»¶è¿Ÿåˆ·æ–°æ›´åˆç†
   â””â”€ é¿å…æ— ç”¨çš„IOæ“ä½œ

åˆ·æ–°ç®—æ³•è€ƒè™‘å› ç´ ï¼š
- é¡µé¢è®¿é—®é¢‘ç‡ï¼ˆLRUä½ç½®ï¼‰
- é¡µé¢ä¿®æ”¹æ—¶é—´ï¼ˆè„é¡µå¹´é¾„ï¼‰
- ç£ç›˜ä½ç½®ï¼ˆå‡å°‘éšæœºIOï¼‰
- äº‹åŠ¡æäº¤çŠ¶æ€ï¼ˆå·²æäº¤ä¼˜å…ˆï¼‰
```

**ğŸ”¹ åˆ·æ–°æ€§èƒ½ä¼˜åŒ–**

```sql
-- è„é¡µåˆ·æ–°ç›¸å…³å‚æ•°
SHOW VARIABLES LIKE '%innodb%flush%';

-- é‡è¦å‚æ•°è¯´æ˜ï¼š
-- innodb_max_dirty_pages_pct = 90        # è„é¡µæ¯”ä¾‹ä¸Šé™
-- innodb_max_dirty_pages_pct_lwm = 10    # å¼€å§‹åˆ·æ–°çš„è„é¡µæ¯”ä¾‹  
-- innodb_flush_neighbors = 1             # åˆ·æ–°é‚»è¿‘é¡µé¢
-- innodb_adaptive_flushing = ON          # è‡ªé€‚åº”åˆ·æ–°
-- innodb_adaptive_flushing_lwm = 10      # è‡ªé€‚åº”åˆ·æ–°è§¦å‘ç‚¹

-- æŸ¥çœ‹å½“å‰è„é¡µæƒ…å†µ
SELECT 
  variable_name,
  variable_value 
FROM performance_schema.global_status 
WHERE variable_name IN (
  'Innodb_buffer_pool_pages_dirty',    -- è„é¡µæ•°é‡
  'Innodb_buffer_pool_pages_total',    -- æ€»é¡µé¢æ•°
  'Innodb_buffer_pool_pages_flushed'   -- å·²åˆ·æ–°é¡µé¢æ•°
);
```

### 5.4 åˆ·æ–°ç­–ç•¥ä¼˜åŒ–


**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒè°ƒä¼˜å»ºè®®**

```sql
-- SSDç¯å¢ƒä¼˜åŒ–ï¼ˆéšæœºIOæ€§èƒ½å¥½ï¼‰
SET GLOBAL innodb_flush_neighbors = 0;  -- ç¦ç”¨é‚»è¿‘é¡µé¢åˆ·æ–°
SET GLOBAL innodb_max_dirty_pages_pct = 75; -- é™ä½è„é¡µæ¯”ä¾‹

-- æœºæ¢°ç¡¬ç›˜ç¯å¢ƒä¼˜åŒ–ï¼ˆé¡ºåºIOæ€§èƒ½å¥½ï¼‰
SET GLOBAL innodb_flush_neighbors = 1;  -- å¯ç”¨é‚»è¿‘é¡µé¢åˆ·æ–°
SET GLOBAL innodb_max_dirty_pages_pct = 50; -- æ›´ä½çš„è„é¡µæ¯”ä¾‹

-- é«˜å¹¶å‘å†™å…¥åœºæ™¯ä¼˜åŒ–
SET GLOBAL innodb_adaptive_flushing_lwm = 5; -- æ›´æ—©å¼€å§‹è‡ªé€‚åº”åˆ·æ–°
SET GLOBAL innodb_max_dirty_pages_pct_lwm = 5; -- æ›´æ—©å¼€å§‹åå°åˆ·æ–°

-- ç›‘æ§åˆ·æ–°æ•ˆæœ
SELECT 
  ROUND(
    (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_pages_dirty') /
    (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_pages_total') * 100,
    2
  ) AS dirty_page_percentage;
```

---

## 6. ğŸ“ˆ ç¼“å†²æ± å‘½ä¸­ç‡ä¼˜åŒ–


### 6.1 ä»€ä¹ˆæ˜¯ç¼“å†²æ± å‘½ä¸­ç‡


**ç®€å•ç†è§£**ï¼šç¼“å†²æ± å‘½ä¸­ç‡å°±åƒæ˜¯"**å›¾ä¹¦é¦†çš„å€Ÿé˜…æ•ˆç‡**"ï¼Œè¡¡é‡æœ‰å¤šå°‘æ¬¡èƒ½ç›´æ¥ä»é˜…è¯»åŒºæ‰¾åˆ°ä¹¦ï¼Œè€Œä¸ç”¨å»ä¹¦åº“å–ã€‚

```
å‘½ä¸­ç‡è®¡ç®—å…¬å¼ï¼š

å‘½ä¸­ç‡ = (ç¼“å†²æ± å‘½ä¸­æ¬¡æ•° / æ€»è¯·æ±‚æ¬¡æ•°) Ã— 100%

å®ä¾‹è®¡ç®—ï¼š
æ€»è¯·æ±‚ï¼š1000æ¬¡
ç¼“å†²æ± å‘½ä¸­ï¼š950æ¬¡  
ç£ç›˜è¯»å–ï¼š50æ¬¡
å‘½ä¸­ç‡ = 950/1000 Ã— 100% = 95%

å‘½ä¸­ç‡ç­‰çº§ï¼š
ğŸŸ¢ ä¼˜ç§€ï¼š>99%    (ç”Ÿäº§ç¯å¢ƒç›®æ ‡)
ğŸŸ¡ è‰¯å¥½ï¼š95-99%  (å¯æ¥å—èŒƒå›´)
ğŸ”´ å·®åŠ²ï¼š<95%    (éœ€è¦ä¼˜åŒ–)
```

### 6.2 å½±å“å‘½ä¸­ç‡çš„å…³é”®å› ç´ 


**ğŸ”¸ ç¼“å†²æ± å¤§å°**

```sql
-- æŸ¥çœ‹å½“å‰ç¼“å†²æ± é…ç½®
SHOW VARIABLES LIKE 'innodb_buffer_pool_size';

-- ç¼“å†²æ± å¤§å°å»ºè®®ï¼š
-- ä¸“ç”¨æ•°æ®åº“æœåŠ¡å™¨ï¼šè®¾ä¸ºç‰©ç†å†…å­˜çš„70-80%
-- æ··åˆåº”ç”¨æœåŠ¡å™¨ï¼šè®¾ä¸ºç‰©ç†å†…å­˜çš„50-60%

-- è®¡ç®—åˆé€‚çš„ç¼“å†²æ± å¤§å°
SELECT 
  ROUND(
    (SELECT SUM(data_length + index_length) FROM information_schema.tables 
     WHERE engine = 'InnoDB') / 1024 / 1024 / 1024, 
    2
  ) AS total_innodb_gb,
  ROUND(
    (SELECT variable_value FROM performance_schema.global_variables 
     WHERE variable_name = 'innodb_buffer_pool_size') / 1024 / 1024 / 1024, 
    2
  ) AS buffer_pool_gb;
```

**ğŸ”¸ æ•°æ®è®¿é—®æ¨¡å¼**

```
ä¸åŒè®¿é—®æ¨¡å¼å¯¹å‘½ä¸­ç‡çš„å½±å“ï¼š

1. ğŸ¯ çƒ­ç‚¹æ•°æ®è®¿é—®ï¼ˆé«˜å‘½ä¸­ç‡ï¼‰
   - 80/20æ³•åˆ™ï¼š80%æŸ¥è¯¢è®¿é—®20%æ•°æ®
   - ç´¢å¼•æŸ¥æ‰¾ï¼šWHERE id = ?
   - çƒ­ç‚¹è¡¨æŸ¥è¯¢ï¼šç”¨æˆ·è¡¨ã€è®¢å•è¡¨

2. ğŸ“Š é¡ºåºæ‰«æï¼ˆä¸­ç­‰å‘½ä¸­ç‡ï¼‰
   - é¢„è¯»æœºåˆ¶æœ‰æ•ˆ
   - èŒƒå›´æŸ¥è¯¢ï¼šWHERE date BETWEEN ? AND ?
   - æ’åºæ“ä½œï¼šORDER BYåˆ›å»ºæ—¶é—´

3. ğŸ”€ éšæœºè®¿é—®ï¼ˆä½å‘½ä¸­ç‡ï¼‰
   - å…¨è¡¨æ‰«æå¤§è¡¨
   - è·¨åº¦å¾ˆå¤§çš„INæŸ¥è¯¢
   - å¤æ‚JOINæ“ä½œ

ä¼˜åŒ–ç­–ç•¥ï¼š
- è¯†åˆ«çƒ­ç‚¹æ•°æ®ï¼Œç¡®ä¿å…¶åœ¨ç¼“å†²æ± ä¸­
- ä¼˜åŒ–æŸ¥è¯¢å‡å°‘å…¨è¡¨æ‰«æ
- åˆç†ä½¿ç”¨ç´¢å¼•æé«˜æ•°æ®å±€éƒ¨æ€§
```

### 6.3 å‘½ä¸­ç‡ç›‘æ§ä¸è¯Šæ–­


**ğŸ”¹ å‘½ä¸­ç‡ç›‘æ§SQL**

```sql
-- è¯¦ç»†çš„ç¼“å†²æ± å‘½ä¸­ç‡åˆ†æ
SELECT 
  'Buffer Pool Hit Rate' as metric,
  ROUND(
    (1 - 
     (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_reads') /
     (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_read_requests')
    ) * 100, 4
  ) as hit_rate_percent;

-- ç¼“å†²æ± ä½¿ç”¨æƒ…å†µè¯¦æƒ…
SELECT 
  'Total Pages' as metric, 
  variable_value as value
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_buffer_pool_pages_total'
UNION ALL
SELECT 
  'Data Pages', 
  variable_value
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_buffer_pool_pages_data'
UNION ALL
SELECT 
  'Dirty Pages', 
  variable_value
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_buffer_pool_pages_dirty'
UNION ALL
SELECT 
  'Free Pages', 
  variable_value
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_buffer_pool_pages_free';
```

**ğŸ”¹ å‘½ä¸­ç‡é—®é¢˜è¯Šæ–­**

```sql
-- åˆ†æLRUé˜Ÿåˆ—çŠ¶æ€
SHOW ENGINE INNODB STATUS\G

-- é‡ç‚¹å…³æ³¨ä»¥ä¸‹æŒ‡æ ‡ï¼š
-- Buffer pool hit rate: 999 / 1000       # å‘½ä¸­ç‡
-- Young-making rate: 132.00 Per second   # NewåŒºæ™‹å‡é€Ÿç‡
-- Non-young-making rate: 0.00 Per second # OldåŒºè®¿é—®ä½†æœªæ™‹å‡
-- Pages made young: 15907                # ç´¯è®¡æ™‹å‡é¡µé¢æ•°
-- Pages evicted without access: 0        # é¢„è¯»ä½†æœªè®¿é—®å°±æ·˜æ±°çš„é¡µé¢

-- è¯Šæ–­å»ºè®®ï¼š
-- 1. å‘½ä¸­ç‡<99%ï¼šå¢åŠ ç¼“å†²æ± å¤§å°
-- 2. Young-making rateå¾ˆé«˜ï¼šå¯èƒ½æœ‰å¤§é‡æ‰«ææ“ä½œ
-- 3. Pages evicted without accesså¤šï¼šé¢„è¯»å‚æ•°éœ€è¦è°ƒæ•´
```

### 6.4 å‘½ä¸­ç‡ä¼˜åŒ–ç­–ç•¥


**ğŸ”¹ é…ç½®å‚æ•°ä¼˜åŒ–**

```sql
-- åŸºç¡€é…ç½®ä¼˜åŒ–
SET GLOBAL innodb_buffer_pool_size = 2147483648;  -- 2GBï¼Œéœ€é‡å¯ç”Ÿæ•ˆ

-- LRUç®—æ³•è°ƒä¼˜
SET GLOBAL innodb_old_blocks_pct = 25;           -- OldåŒºæ¯”ä¾‹è°ƒå°
SET GLOBAL innodb_old_blocks_time = 2000;        -- æ™‹å‡ç­‰å¾…æ—¶é—´åŠ é•¿

-- é¢„è¯»ç­–ç•¥è°ƒä¼˜  
SET GLOBAL innodb_read_ahead_threshold = 56;     -- çº¿æ€§é¢„è¯»é˜ˆå€¼
SET GLOBAL innodb_random_read_ahead = OFF;       -- å…³é—­éšæœºé¢„è¯»

-- å¤šå®ä¾‹ä¼˜åŒ–ï¼ˆMySQL 5.7+ï¼‰
SET GLOBAL innodb_buffer_pool_instances = 8;     -- 8ä¸ªç¼“å†²æ± å®ä¾‹
```

**ğŸ”¹ åº”ç”¨å±‚ä¼˜åŒ–ç­–ç•¥**

```sql
-- 1. æŸ¥è¯¢ä¼˜åŒ–
-- é¿å…SELECT *ï¼ŒåªæŸ¥è¯¢éœ€è¦çš„åˆ—
SELECT id, name FROM users WHERE status = 'active';

-- 2. ç´¢å¼•ä¼˜åŒ–  
-- åˆ›å»ºå¤åˆç´¢å¼•å‡å°‘å›è¡¨
CREATE INDEX idx_user_status_name ON users(status, name);

-- 3. åˆ†é¡µä¼˜åŒ–
-- é¿å…å¤§OFFSETåˆ†é¡µ
SELECT * FROM users WHERE id > last_id ORDER BY id LIMIT 20;

-- 4. æ‰¹é‡æ“ä½œ
-- å‡å°‘å°äº‹åŠ¡ï¼Œå¢åŠ æ‰¹æ¬¡å¤§å°
INSERT INTO users (name, email) VALUES 
('user1', 'user1@example.com'),
('user2', 'user2@example.com'),
('user3', 'user3@example.com');
```

---

## 7. ğŸ§  å†…å­˜è®¿é—®æ¨¡å¼ä¼˜åŒ–


### 7.1 å†…å­˜è®¿é—®æ¨¡å¼åˆ†æ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å†…å­˜è®¿é—®æ¨¡å¼**

å†…å­˜è®¿é—®æ¨¡å¼å°±æ˜¯åº”ç”¨ç¨‹åºè®¿é—®æ•°æ®çš„"**è¡Œä¸ºä¹ æƒ¯**"ï¼Œä¸åŒçš„è®¿é—®æ¨¡å¼å¯¹ç¼“å†²æ± çš„å½±å“å®Œå…¨ä¸åŒã€‚

```
è®¿é—®æ¨¡å¼åˆ†ç±»ï¼š

1. ğŸ¯ å±€éƒ¨æ€§è®¿é—®ï¼ˆLocality Accessï¼‰
æ—¶é—´å±€éƒ¨æ€§ï¼šåˆšè®¿é—®çš„æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è¢«è®¿é—®
ç©ºé—´å±€éƒ¨æ€§ï¼šç›¸é‚»çš„æ•°æ®å¾ˆå¯èƒ½è¢«ä¸€èµ·è®¿é—®

ä¾‹å­ï¼š
SELECT * FROM users WHERE id = 100;     -- æ—¶é—´å±€éƒ¨æ€§
SELECT * FROM users WHERE id BETWEEN 100 AND 110; -- ç©ºé—´å±€éƒ¨æ€§

2. ğŸ”€ éšæœºè®¿é—®ï¼ˆRandom Accessï¼‰  
è®¿é—®æ¨¡å¼æ— è§„å¾‹ï¼Œç¼“å­˜æ•ˆæœå·®

ä¾‹å­ï¼š
SELECT * FROM users WHERE id IN (1, 1000, 5000, 9999); -- éšæœºè®¿é—®

3. ğŸ“Š é¡ºåºè®¿é—®ï¼ˆSequential Accessï¼‰
æŒ‰é¡ºåºè®¿é—®æ•°æ®ï¼Œé¢„è¯»æ•ˆæœå¥½

ä¾‹å­ï¼š  
SELECT * FROM orders ORDER BY create_time; -- é¡ºåºè®¿é—®
```

### 7.2 è®¿é—®æ¨¡å¼å¯¹ç¼“å†²æ± çš„å½±å“


**ğŸ”¸ ä¸åŒæ¨¡å¼çš„æ€§èƒ½è¡¨ç°**

```
æ€§èƒ½å¯¹æ¯”åˆ†æï¼š

å±€éƒ¨æ€§è®¿é—®ï¼š
â”œâ”€ ç¼“å†²æ± å‘½ä¸­ç‡ï¼š>99%
â”œâ”€ ç£ç›˜IOï¼šæå°‘
â”œâ”€ æŸ¥è¯¢å“åº”æ—¶é—´ï¼š<1ms
â””â”€ æœ€é€‚åˆOLTPåº”ç”¨

é¡ºåºè®¿é—®ï¼š
â”œâ”€ ç¼“å†²æ± å‘½ä¸­ç‡ï¼š80-95%  
â”œâ”€ ç£ç›˜IOï¼šé¢„è¯»ä¼˜åŒ–
â”œâ”€ æŸ¥è¯¢å“åº”æ—¶é—´ï¼š1-10ms
â””â”€ é€‚åˆæŠ¥è¡¨åˆ†æ

éšæœºè®¿é—®ï¼š
â”œâ”€ ç¼“å†²æ± å‘½ä¸­ç‡ï¼š<50%
â”œâ”€ ç£ç›˜IOï¼šå¤§é‡éšæœºIO
â”œâ”€ æŸ¥è¯¢å“åº”æ—¶é—´ï¼š>100ms  
â””â”€ åº”è¯¥é¿å…çš„æ¨¡å¼
```

**ğŸ”¹ è®¿é—®æ¨¡å¼ç›‘æ§**

```sql
-- ç›‘æ§ä¸åŒç±»å‹çš„è®¿é—®
SELECT 
  table_schema,
  table_name,
  rows_examined / rows_sent as avg_rows_examined_per_row,
  CASE 
    WHEN rows_examined / rows_sent < 10 THEN 'Good Selectivity'
    WHEN rows_examined / rows_sent < 100 THEN 'Moderate Selectivity' 
    ELSE 'Poor Selectivity'
  END as access_pattern
FROM performance_schema.table_io_waits_summary_by_table 
WHERE count_read > 0 
ORDER BY rows_examined DESC;
```

### 7.3 å†…å­˜è®¿é—®ä¼˜åŒ–æŠ€æœ¯


**ğŸ”¸ æ•°æ®å¸ƒå±€ä¼˜åŒ–**

```sql
-- 1. èšç°‡ç´¢å¼•ä¼˜åŒ–
-- ä¸»é”®é€‰æ‹©å½±å“æ•°æ®ç‰©ç†å­˜å‚¨é¡ºåº
CREATE TABLE orders (
  id INT AUTO_INCREMENT PRIMARY KEY,    -- é¡ºåºä¸»é”®
  user_id INT,
  order_time DATETIME,
  -- ä¸è¦ä½¿ç”¨UUIDä½œä¸ºä¸»é”®ï¼Œä¼šå¯¼è‡´é¡µé¢åˆ†è£‚
  INDEX idx_user_time (user_id, order_time)  -- å¤åˆç´¢å¼•
);

-- 2. åˆ†åŒºä¼˜åŒ–
-- æŒ‰æ—¶é—´åˆ†åŒºï¼Œæé«˜è®¿é—®å±€éƒ¨æ€§
CREATE TABLE logs (
  id BIGINT AUTO_INCREMENT,
  log_time DATETIME,
  message TEXT,
  PRIMARY KEY (id, log_time)
) PARTITION BY RANGE (YEAR(log_time)) (
  PARTITION p2023 VALUES LESS THAN (2024),
  PARTITION p2024 VALUES LESS THAN (2025),
  PARTITION p2025 VALUES LESS THAN (2026)
);
```

**ğŸ”¸ æŸ¥è¯¢æ¨¡å¼ä¼˜åŒ–**

```sql
-- ä¼˜åŒ–å‰ï¼šéšæœºè®¿é—®æ¨¡å¼
SELECT * FROM users WHERE id IN (
  SELECT user_id FROM orders WHERE status = 'pending'
);

-- ä¼˜åŒ–åï¼šè¿æ¥æŸ¥è¯¢ï¼Œåˆ©ç”¨ç´¢å¼•
SELECT u.* FROM users u
INNER JOIN orders o ON u.id = o.user_id  
WHERE o.status = 'pending';

-- ä¼˜åŒ–å‰ï¼šå¤§èŒƒå›´æ‰«æ
SELECT * FROM orders 
WHERE create_time >= '2024-01-01' 
AND create_time <= '2024-12-31'
ORDER BY total_amount DESC
LIMIT 10;

-- ä¼˜åŒ–åï¼šå¢åŠ ç´¢å¼•ï¼Œå‡å°‘æ‰«æèŒƒå›´
CREATE INDEX idx_time_amount ON orders(create_time, total_amount);
```

### 7.4 ç¼“å†²æ± å®ä¾‹ä¼˜åŒ–


**ğŸ”¸ å¤šå®ä¾‹é…ç½®**

```sql
-- MySQL 5.7+æ”¯æŒå¤šç¼“å†²æ± å®ä¾‹
-- å‡å°‘é”ç«äº‰ï¼Œæé«˜å¹¶å‘æ€§èƒ½

-- æŸ¥çœ‹å½“å‰å®ä¾‹æ•°
SHOW VARIABLES LIKE 'innodb_buffer_pool_instances';

-- ä¼˜åŒ–å»ºè®®ï¼š
-- ç¼“å†²æ± å¤§å° â‰¥ 1GB æ—¶æ‰å¯ç”¨å¤šå®ä¾‹
-- å®ä¾‹æ•° = CPUæ ¸å¿ƒæ•°ï¼Œæœ€å¤§64ä¸ª
-- æ¯ä¸ªå®ä¾‹è‡³å°‘1GB

-- é…ç½®ç¤ºä¾‹ï¼ˆmy.cnfï¼‰ï¼š
-- innodb_buffer_pool_size = 8G
-- innodb_buffer_pool_instances = 8    # æ¯ä¸ªå®ä¾‹1GB

-- ç›‘æ§å¤šå®ä¾‹æ•ˆæœ
SELECT 
  pool_id,
  pages_made_young,
  pages_not_made_young,
  pages_made_young / (pages_made_young + pages_not_made_young) as young_rate
FROM information_schema.innodb_buffer_pool_stats 
ORDER BY pool_id;
```

**ğŸ”¸ NUMAæ¶æ„ä¼˜åŒ–**

```bash
# NUMAæ„ŸçŸ¥é…ç½®
# æŸ¥çœ‹NUMAæ¶æ„
numactl --hardware

# MySQLå¯åŠ¨æ—¶ç»‘å®šNUMAèŠ‚ç‚¹
numactl --cpunodebind=0 --membind=0 mysqld_safe &

# æˆ–è€…ç¦ç”¨NUMAï¼ˆåœ¨my.cnfä¸­ï¼‰
# innodb_numa_interleave = ON
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç´¢å¼•ä¸ç¼“å†²æ± äº¤äº’ï¼šå†…å­˜ä¸­çš„ç´¢å¼•é¡µé¢ç®¡ç†ï¼Œå†³å®šæŸ¥è¯¢æ€§èƒ½
ğŸ”¸ æ”¹è¿›LRUç®—æ³•ï¼šåˆ†æ®µå¼LRUï¼Œè§£å†³ç¼“å­˜æ±¡æŸ“é—®é¢˜  
ğŸ”¸ é¢„è¯»ç­–ç•¥ï¼šçº¿æ€§é¢„è¯»å’Œéšæœºé¢„è¯»ï¼Œæå‰åŠ è½½å¯èƒ½éœ€è¦çš„é¡µé¢
ğŸ”¸ è„é¡µåˆ·æ–°ï¼šä¿è¯æ•°æ®æŒä¹…æ€§ï¼Œä¼˜åŒ–åˆ·æ–°æ—¶æœºå’Œä¼˜å…ˆçº§
ğŸ”¸ å‘½ä¸­ç‡ä¼˜åŒ–ï¼šé€šè¿‡é…ç½®è°ƒä¼˜å’Œè®¿é—®æ¨¡å¼ä¼˜åŒ–æé«˜å‘½ä¸­ç‡
ğŸ”¸ å†…å­˜è®¿é—®æ¨¡å¼ï¼šç†è§£ä¸åŒè®¿é—®æ¨¡å¼å¯¹æ€§èƒ½çš„å½±å“
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ LRUç®—æ³•çš„æ”¹è¿›æ„ä¹‰**
```
ä¼ ç»ŸLRUé—®é¢˜ï¼š
- å…¨è¡¨æ‰«æä¼šå†²åˆ·çƒ­ç‚¹æ•°æ®
- æ— æ³•åŒºåˆ†çƒ­ç‚¹æ•°æ®å’Œä¸´æ—¶æ•°æ®

MySQLæ”¹è¿›æ–¹æ¡ˆï¼š  
- åˆ†æ®µLRUï¼šNewåŒº + OldåŒº
- æ™‹å‡æœºåˆ¶ï¼šæ—¶é—´çª—å£ + è®¿é—®éªŒè¯
- é¿å…ç¼“å­˜æ±¡æŸ“ï¼šä¿æŠ¤çœŸæ­£çš„çƒ­ç‚¹æ•°æ®
```

**ğŸ”¹ é¢„è¯»ç­–ç•¥çš„å¹³è¡¡**
```
é¢„è¯»æ”¶ç›Šï¼š
- é¡ºåºè®¿é—®æ—¶å¤§å¹…æå‡æ€§èƒ½
- å‡å°‘ç£ç›˜éšæœºIOæ“ä½œ
- æé«˜ç£ç›˜å¸¦å®½åˆ©ç”¨ç‡

é¢„è¯»ä»£ä»·ï¼š
- å¯èƒ½è¯»å–æ— ç”¨çš„é¡µé¢
- å ç”¨å®è´µçš„ç¼“å†²æ± ç©ºé—´
- å¢åŠ ç£ç›˜IOè´Ÿæ‹…

ä¼˜åŒ–åŸåˆ™ï¼š
- æ ¹æ®åº”ç”¨è®¿é—®æ¨¡å¼è°ƒæ•´å‚æ•°
- ç›‘æ§é¢„è¯»æ•ˆæœï¼Œé¿å…è¿‡åº¦é¢„è¯»
- SSDç¯å¢ƒå¯ä»¥æ›´æ¿€è¿›çš„é¢„è¯»ç­–ç•¥
```

**ğŸ”¹ è„é¡µåˆ·æ–°çš„å¹³è¡¡**
```
åˆ·æ–°æ—¶æœºå¹³è¡¡ï¼š
- å¤ªé¢‘ç¹ï¼šå½±å“å‰å°æŸ¥è¯¢æ€§èƒ½
- å¤ªå»¶è¿Ÿï¼šå´©æºƒæ¢å¤æ—¶é—´é•¿ï¼Œå†…å­˜ä¸è¶³

ä¼˜å…ˆçº§ç­–ç•¥ï¼š
- OldåŒºè„é¡µä¼˜å…ˆï¼šå½±å“æœ€å°
- è¿ç»­é¡µé¢æ‰¹é‡ï¼šæé«˜IOæ•ˆç‡
- å·²æäº¤äº‹åŠ¡ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§
```

### 8.3 å®é™…ä¼˜åŒ–åº”ç”¨


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–æ£€æŸ¥æ¸…å•**

```
é…ç½®ä¼˜åŒ–ï¼š
â˜‘ ç¼“å†²æ± å¤§å°è®¾ç½®ä¸ºå†…å­˜çš„70-80%
â˜‘ OldåŒºæ¯”ä¾‹è°ƒæ•´ä¸º25-37%ï¼ˆæ ¹æ®æ‰«æé¢‘ç‡ï¼‰
â˜‘ é¢„è¯»é˜ˆå€¼æ ¹æ®è®¿é—®æ¨¡å¼è°ƒæ•´
â˜‘ å¤šå®ä¾‹é…ç½®ï¼ˆå¤§ç¼“å†²æ± åœºæ™¯ï¼‰
â˜‘ NUMAæ¶æ„ä¼˜åŒ–ï¼ˆå¤šCPUåœºæ™¯ï¼‰

ç›‘æ§æŒ‡æ ‡ï¼š
â˜‘ ç¼“å†²æ± å‘½ä¸­ç‡ >99%
â˜‘ è„é¡µæ¯”ä¾‹ <90%
â˜‘ Young-making rate é€‚ä¸­
â˜‘ Pages evicted without access å°½é‡å°‘

åº”ç”¨ä¼˜åŒ–ï¼š  
â˜‘ ç´¢å¼•ä¼˜åŒ–å‡å°‘å›è¡¨
â˜‘ æŸ¥è¯¢ä¼˜åŒ–é¿å…å…¨è¡¨æ‰«æ
â˜‘ åˆ†é¡µæŸ¥è¯¢é¿å…å¤§offset
â˜‘ æ‰¹é‡æ“ä½œå‡å°‘å°äº‹åŠ¡
â˜‘ åˆç†çš„ä¸»é”®è®¾è®¡
```

**ğŸ”§ å¸¸è§æ€§èƒ½é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**

```
é—®é¢˜1ï¼šç¼“å†²æ± å‘½ä¸­ç‡ä½
åŸå› ï¼šç¼“å†²æ± å¤ªå°æˆ–å¤§é‡æ‰«æ
è§£å†³ï¼šå¢åŠ ç¼“å†²æ± å¤§å°ï¼Œä¼˜åŒ–æŸ¥è¯¢

é—®é¢˜2ï¼šè„é¡µæ¯”ä¾‹è¿‡é«˜
åŸå› ï¼šå†™å…¥è¿‡å¿«ï¼Œåˆ·æ–°è·Ÿä¸ä¸Š
è§£å†³ï¼šè°ƒæ•´åˆ·æ–°å‚æ•°ï¼Œä¼˜åŒ–IO

é—®é¢˜3ï¼šé¢„è¯»æ•ˆæœå·®
åŸå› ï¼šé¢„è¯»å‚æ•°ä¸åˆé€‚
è§£å†³ï¼šæ ¹æ®è®¿é—®æ¨¡å¼è°ƒæ•´é˜ˆå€¼

é—®é¢˜4ï¼šLRUæŠ–åŠ¨ä¸¥é‡
åŸå› ï¼šå†…å­˜ä¸è¶³æˆ–ç¼“å­˜æ±¡æŸ“
è§£å†³ï¼šå¢åŠ å†…å­˜ï¼Œè°ƒæ•´LRUå‚æ•°
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç¼“å†²æ± æ˜¯ç´¢å¼•æ€§èƒ½çš„æ ¸å¿ƒï¼Œåˆç†é…ç½®æ˜¯å…³é”®
- LRUç®—æ³•è¦å¹³è¡¡çƒ­ç‚¹ä¿æŠ¤å’Œç¼“å­˜æ›´æ–°
- é¢„è¯»ç­–ç•¥è¦åŒ¹é…åº”ç”¨çš„è®¿é—®æ¨¡å¼
- è„é¡µåˆ·æ–°è¦å¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨
- ç›‘æ§å’Œè°ƒä¼˜æ˜¯æŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡å˜åŒ–è°ƒæ•´