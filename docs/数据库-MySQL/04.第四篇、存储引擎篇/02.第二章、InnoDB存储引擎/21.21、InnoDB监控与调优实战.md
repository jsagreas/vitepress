---
title: 21ã€InnoDBç›‘æ§ä¸è°ƒä¼˜å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [InnoDBç›‘æ§åŸºç¡€æ¦‚è¿°](#1-InnoDBç›‘æ§åŸºç¡€æ¦‚è¿°)
2. [Performance Schemaç›‘æ§ä½“ç³»](#2-Performance-Schemaç›‘æ§ä½“ç³»)
3. [SHOW ENGINE INNODB STATUSè¯¦è§£](#3-SHOW-ENGINE-INNODB-STATUSè¯¦è§£)
4. [sys schemaç›‘æ§è§†å›¾å®æˆ˜](#4-sys-schemaç›‘æ§è§†å›¾å®æˆ˜)
5. [å…³é”®æ€§èƒ½æŒ‡æ ‡ç›‘æ§](#5-å…³é”®æ€§èƒ½æŒ‡æ ‡ç›‘æ§)
6. [å†…å­˜ä½¿ç”¨ç›‘æ§åˆ†æ](#6-å†…å­˜ä½¿ç”¨ç›‘æ§åˆ†æ)
7. [IOæ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–](#7-IOæ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–)
8. [é”ç­‰å¾…ç›‘æ§è¯Šæ–­](#8-é”ç­‰å¾…ç›‘æ§è¯Šæ–­)
9. [äº‹åŠ¡ç›‘æ§åˆ†æ](#9-äº‹åŠ¡ç›‘æ§åˆ†æ)
10. [ç›‘æ§è‡ªåŠ¨åŒ–ä¸å‘Šè­¦](#10-ç›‘æ§è‡ªåŠ¨åŒ–ä¸å‘Šè­¦)
11. [è°ƒä¼˜å®æˆ˜æ¡ˆä¾‹](#11-è°ƒä¼˜å®æˆ˜æ¡ˆä¾‹)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ InnoDBç›‘æ§åŸºç¡€æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯InnoDBç›‘æ§


**ğŸ“‹ ç›‘æ§çš„æœ¬è´¨å«ä¹‰**
```
InnoDBç›‘æ§ï¼šå®æ—¶è§‚å¯Ÿå’Œåˆ†æInnoDBå­˜å‚¨å¼•æ“çš„è¿è¡ŒçŠ¶æ€
æ ¸å¿ƒç›®çš„ï¼š
â€¢ å‘ç°æ€§èƒ½ç“¶é¢ˆå’Œæ½œåœ¨é—®é¢˜
â€¢ è¯„ä¼°ç³»ç»Ÿèµ„æºä½¿ç”¨æ•ˆç‡
â€¢ ä¸ºæ€§èƒ½è°ƒä¼˜æä¾›æ•°æ®æ”¯æ’‘
â€¢ é¢„é˜²æ•…éšœå’Œä¿éšœç¨³å®šæ€§

ç›‘æ§å°±åƒåŒ»ç”Ÿä½“æ£€ï¼š
â€¢ å®šæœŸæ£€æŸ¥å„é¡¹"å¥åº·æŒ‡æ ‡"
â€¢ åŠæ—¶å‘ç°"äºšå¥åº·"çŠ¶æ€
â€¢ å¯¹ç—‡ä¸‹è¯è¿›è¡Œ"æ²»ç–—"è°ƒä¼˜
```

### 1.2 InnoDBç›‘æ§çš„é‡è¦æ€§


**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§**
```
æ•°æ®åº“çš„"é»‘ç›’"ç‰¹æ€§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    åº”ç”¨è¯·æ±‚     â”‚ â†’ SQLæŸ¥è¯¢ã€äº‹åŠ¡æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   InnoDBå¼•æ“    â”‚ â†’ å†…éƒ¨å¤„ç†è¿‡ç¨‹ä¸å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è¿”å›ç»“æœ      â”‚ â†’ æŸ¥è¯¢ç»“æœã€æ‰§è¡ŒçŠ¶æ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
â€¢ åº”ç”¨åªçœ‹åˆ°ç»“æœï¼Œçœ‹ä¸åˆ°å†…éƒ¨å¤„ç†è¿‡ç¨‹
â€¢ æ€§èƒ½é—®é¢˜å‘ç”Ÿæ—¶ï¼Œä¸çŸ¥é“å…·ä½“åŸå› 
â€¢ æ— æ³•é¢„åˆ¤ç³»ç»Ÿç“¶é¢ˆå’Œå®¹é‡é™åˆ¶

ç›‘æ§è§£å†³ï¼š
â€¢ é€æ˜åŒ–å†…éƒ¨è¿è¡ŒçŠ¶æ€
â€¢ é‡åŒ–æ€§èƒ½æŒ‡æ ‡å’Œèµ„æºä½¿ç”¨
â€¢ å»ºç«‹é—®é¢˜è¯Šæ–­å’Œä¼˜åŒ–ä¾æ®
```

### 1.3 InnoDBç›‘æ§ä½“ç³»æ¶æ„


**ğŸ—ï¸ ç›‘æ§æ•°æ®æ¥æº**
```
ç›‘æ§æ•°æ®çš„å±‚æ¬¡ç»“æ„ï¼š

ç³»ç»Ÿå±‚ç›‘æ§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œç³»ç»ŸæŒ‡æ ‡     â”‚ â†’ CPUã€å†…å­˜ã€ç£ç›˜IOã€ç½‘ç»œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
MySQLæœåŠ¡å±‚ç›‘æ§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQLå…¨å±€çŠ¶æ€   â”‚ â†’ è¿æ¥æ•°ã€æŸ¥è¯¢ç»Ÿè®¡ã€ç¼“å­˜å‘½ä¸­
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
InnoDBå­˜å‚¨å¼•æ“å±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ InnoDBå†…éƒ¨çŠ¶æ€  â”‚ â†’ ç¼“å†²æ± ã€é”ã€äº‹åŠ¡ã€IOç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç›‘æ§å·¥å…·ï¼š
â€¢ Performance Schemaï¼šMySQLå†…ç½®æ€§èƒ½ç›‘æ§
â€¢ sys schemaï¼šç®€åŒ–çš„ç›‘æ§è§†å›¾
â€¢ SHOW ENGINE INNODB STATUSï¼šå®æ—¶çŠ¶æ€å¿«ç…§
â€¢ ç¬¬ä¸‰æ–¹å·¥å…·ï¼šPercona Monitoringã€PMMç­‰
```

---

## 2. ğŸ“Š Performance Schemaç›‘æ§ä½“ç³»


### 2.1 Performance SchemaåŸºç¡€


**ğŸ“ ä»€ä¹ˆæ˜¯Performance Schema**
```
Performance Schemaï¼šMySQLçš„å†…ç½®æ€§èƒ½ç›‘æ§æ¡†æ¶
ç‰¹ç‚¹ï¼š
â€¢ è¿è¡Œæ—¶å®æ—¶æ”¶é›†æ€§èƒ½æ•°æ®
â€¢ é›¶æ‹·è´ã€ä½å¼€é”€çš„ç›‘æ§æ–¹å¼  
â€¢ æä¾›ä¸°å¯Œçš„æ€§èƒ½ç»Ÿè®¡è¡¨
â€¢ æ”¯æŒåŠ¨æ€å¼€å¯å…³é—­ç›‘æ§é¡¹ç›®

ç®€å•ç†è§£ï¼š
å°±åƒæ±½è½¦çš„ä»ªè¡¨ç›˜ï¼Œå®æ—¶æ˜¾ç¤ºå„ç§è¿è¡Œå‚æ•°
â€¢ å¼•æ“è½¬é€Ÿ â†’ SQLæ‰§è¡Œé¢‘ç‡
â€¢ æ²¹è€—æƒ…å†µ â†’ èµ„æºä½¿ç”¨ç»Ÿè®¡
â€¢ æ¸©åº¦æŒ‡æ ‡ â†’ ç³»ç»Ÿè´Ÿè½½çŠ¶æ€
```

### 2.2 Performance Schemaæ ¸å¿ƒè¡¨


**ğŸ” é‡è¦ç›‘æ§è¡¨åˆ†ç±»**
```sql
-- 1. è¿æ¥å’Œä¼šè¯ç›‘æ§
SELECT * FROM performance_schema.threads 
WHERE type = 'FOREGROUND';  -- æŸ¥çœ‹å½“å‰è¿æ¥çº¿ç¨‹

-- 2. SQLè¯­å¥ç›‘æ§  
SELECT * FROM performance_schema.events_statements_summary_by_digest 
ORDER BY sum_timer_wait DESC LIMIT 10;  -- æœ€è€—æ—¶çš„SQL

-- 3. ç­‰å¾…äº‹ä»¶ç›‘æ§
SELECT * FROM performance_schema.events_waits_summary_global_by_event_name
WHERE event_name LIKE '%innodb%' 
ORDER BY sum_timer_wait DESC;  -- InnoDBç­‰å¾…äº‹ä»¶

-- 4. IOç›‘æ§
SELECT * FROM performance_schema.file_summary_by_instance
WHERE file_name LIKE '%ib%';  -- InnoDBæ–‡ä»¶IOç»Ÿè®¡
```

**ğŸ’¡ Performance Schemaé…ç½®**
```sql
-- æŸ¥çœ‹å½“å‰é…ç½®çŠ¶æ€
SELECT * FROM performance_schema.setup_consumers;  -- æ¶ˆè´¹è€…å¼€å¯çŠ¶æ€
SELECT * FROM performance_schema.setup_instruments  -- ç›‘æ§å·¥å…·å¼€å¯çŠ¶æ€
WHERE name LIKE '%innodb%';

-- åŠ¨æ€å¼€å¯InnoDBç›¸å…³ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET enabled = 'YES' 
WHERE name LIKE '%innodb%';

-- å¼€å¯è¯­å¥ç›‘æ§
UPDATE performance_schema.setup_consumers 
SET enabled = 'YES' 
WHERE name = 'events_statements_current';
```

### 2.3 Performance Schemaå®é™…åº”ç”¨


**âš¡ å¸¸ç”¨ç›‘æ§æŸ¥è¯¢**

> ğŸ“ˆ **æŸ¥çœ‹å½“å‰æ´»è·ƒè¿æ¥çŠ¶æ€**

```sql
SELECT 
    t.thread_id,
    t.processlist_id,
    t.processlist_user,
    t.processlist_host,
    t.processlist_db,
    t.processlist_command,
    t.processlist_info,
    t.processlist_time
FROM performance_schema.threads t
WHERE t.type = 'FOREGROUND' 
  AND t.processlist_command != 'Sleep'
ORDER BY t.processlist_time DESC;

-- æ˜¾ç¤ºæ­£åœ¨æ‰§è¡Œçš„SQLå’Œæ‰§è¡Œæ—¶é—´
-- å¸®åŠ©å‘ç°é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
```

> ğŸ”¥ **åˆ†ææœ€æ¶ˆè€—èµ„æºçš„SQL**

```sql
SELECT 
    digest_text,
    count_star AS exec_count,
    avg_timer_wait/1000000000 AS avg_time_sec,
    sum_timer_wait/1000000000 AS total_time_sec,
    sum_lock_time/1000000000 AS total_lock_time_sec,
    sum_rows_examined,
    sum_rows_sent
FROM performance_schema.events_statements_summary_by_digest 
WHERE digest_text IS NOT NULL
ORDER BY sum_timer_wait DESC 
LIMIT 20;

-- å…³é”®æŒ‡æ ‡è§£é‡Šï¼š
-- exec_count: æ‰§è¡Œæ¬¡æ•°
-- avg_time_sec: å¹³å‡æ‰§è¡Œæ—¶é—´
-- total_time_sec: æ€»æ‰§è¡Œæ—¶é—´  
-- sum_rows_examined: æ€»æ‰«æè¡Œæ•°
```

---

## 3. ğŸ” SHOW ENGINE INNODB STATUSè¯¦è§£


### 3.1 å‘½ä»¤åŸºç¡€ç”¨æ³•


**ğŸ“‹ SHOW ENGINE INNODB STATUSæ¦‚è¿°**
```sql
SHOW ENGINE INNODB STATUS;

è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨ï¼š
â€¢ æ˜¾ç¤ºInnoDBå¼•æ“çš„å®æ—¶è¿è¡ŒçŠ¶æ€
â€¢ åŒ…å«ç¼“å†²æ± ã€äº‹åŠ¡ã€é”ã€IOç­‰è¯¦ç»†ä¿¡æ¯
â€¢ æ˜¯InnoDBé—®é¢˜è¯Šæ–­çš„æ ¸å¿ƒå·¥å…·
â€¢ è¾“å‡ºä¿¡æ¯ä¸°å¯Œä½†éœ€è¦æ­£ç¡®è§£è¯»

ä½¿ç”¨åœºæ™¯ï¼š
â€¢ æ€§èƒ½é—®é¢˜è¯Šæ–­
â€¢ ç³»ç»Ÿç“¶é¢ˆåˆ†æ
â€¢ æ—¥å¸¸å¥åº·æ£€æŸ¥
â€¢ å®¹é‡è§„åˆ’è¯„ä¼°
```

### 3.2 è¾“å‡ºä¿¡æ¯è¯¦è§£


**ğŸ” æ ¸å¿ƒä¿¡æ¯åˆ†å—è§£è¯»**

> ğŸ’¾ **ç¼“å†²æ± çŠ¶æ€ä¿¡æ¯**

```
BUFFER POOL AND MEMORY
----------------------
Total large memory allocated 137363456
Dictionary memory allocated 76720
Buffer pool size   8192        # ç¼“å†²æ± é¡µæ•°ï¼ˆ16KB/é¡µï¼‰
Free buffers       1024        # ç©ºé—²é¡µæ•°
Database pages     7168        # æ•°æ®é¡µæ•°  
Old database pages 2646        # LRUé“¾è¡¨oldæ®µé¡µæ•°
Modified db pages  256         # è„é¡µæ•°é‡
Pending reads      0           # ç­‰å¾…è¯»å–çš„é¡µæ•°
Pending writes: LRU 0, flush list 0, single page 0

å…³é”®æŒ‡æ ‡è§£è¯»ï¼š
âœ“ Buffer pool size: ç¼“å†²æ± æ€»å¤§å°ï¼ˆé¡µæ•°ï¼‰
âœ“ Free buffers: ç©ºé—²ç¼“å†²åŒºæ•°é‡
âœ“ Modified db pages: è„é¡µæ•°é‡ï¼ˆéœ€è¦å†™å›ç£ç›˜ï¼‰
âœ“ Database pages: ç¼“å­˜çš„æ•°æ®é¡µæ•°é‡
```

> âš¡ **IOæ´»åŠ¨ç»Ÿè®¡**

```
INSERT BUFFER AND ADAPTIVE HASH INDEX
-------------------------------------
Ibuf: size 1, free list len 0, seg size 2, 0 merges
merged operations:
 insert 0, delete mark 0, delete 0
discarded operations:
 insert 0, delete mark 0, delete 0

FILE I/O
--------
I/O thread 0 state: waiting for completed aio requests (insert buffer thread)
I/O thread 1 state: waiting for completed aio requests (log thread)
I/O thread 2 state: waiting for completed aio requests (read thread)
I/O thread 3 state: waiting for completed aio requests (write thread)
Pending normal aio reads: 0   # ç­‰å¾…çš„å¼‚æ­¥è¯»æ“ä½œ
Pending aio writes: 0         # ç­‰å¾…çš„å¼‚æ­¥å†™æ“ä½œ

å…³é”®ä¿¡æ¯ï¼š
â€¢ IOçº¿ç¨‹çŠ¶æ€ï¼šæ˜¾ç¤ºå„ä¸ªIOçº¿ç¨‹çš„å·¥ä½œçŠ¶æ€
â€¢ Pendingæ“ä½œï¼šç­‰å¾…ä¸­çš„IOæ“ä½œæ•°é‡
â€¢ å¦‚æœPendingæ•°é‡æŒç»­è¾ƒé«˜ï¼Œè¯´æ˜IOæˆä¸ºç“¶é¢ˆ
```

> ğŸ”’ **é”å’Œäº‹åŠ¡ä¿¡æ¯**

```
TRANSACTIONS
------------
Trx id counter 2618
Purge done for trx's n:o < 2618 undo n:o < 0 state: running but idle
History list length 19        # æœªæäº¤äº‹åŠ¡å†å²é•¿åº¦
LIST OF TRANSACTIONS FOR EACH SESSION:
---TRANSACTION 421291825419984, not started
0 lock struct(s), heap size 1136, 0 row lock(s)

LATEST DETECTED DEADLOCK
------------------------
(å¦‚æœæœ‰æ­»é”ï¼Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„æ­»é”ä¿¡æ¯)

å…³é”®æŒ‡æ ‡ï¼š
â€¢ History list length: æœªæ¸…ç†çš„æ—§ç‰ˆæœ¬æ•°æ®é•¿åº¦
â€¢ æ´»è·ƒäº‹åŠ¡ä¿¡æ¯ï¼šæ˜¾ç¤ºå½“å‰è¿è¡Œçš„äº‹åŠ¡çŠ¶æ€
â€¢ æ­»é”æ£€æµ‹ï¼šæœ€è¿‘å‘ç”Ÿçš„æ­»é”è¯¦ç»†ä¿¡æ¯
```

### 3.3 å¸¸è§é—®é¢˜è¯Šæ–­æŠ€å·§


**ğŸ› ï¸ é€šè¿‡çŠ¶æ€ä¿¡æ¯è¯Šæ–­é—®é¢˜**

> ğŸš¨ **å†…å­˜é—®é¢˜è¯Šæ–­**

```
é—®é¢˜ç°è±¡ï¼š
Modified db pages å¾ˆé«˜ï¼ˆæ¯”å¦‚ > ç¼“å†²æ± çš„10%ï¼‰
Pending writes æŒç»­ä¸ä¸º0

è¯Šæ–­åˆ†æï¼š
â€¢ è„é¡µç§¯ç´¯è¿‡å¤šï¼Œåˆ·æ–°é€Ÿåº¦è·Ÿä¸ä¸Š
â€¢ å¯èƒ½æ˜¯ç£ç›˜IOæ€§èƒ½ä¸è¶³
â€¢ æˆ–è€…innodb_io_capacityè®¾ç½®è¿‡ä½

è§£å†³æ–¹æ¡ˆï¼š
â€¢ å¢åŠ innodb_io_capacityå€¼
â€¢ æ£€æŸ¥ç£ç›˜IOæ€§èƒ½
â€¢ è°ƒæ•´è„é¡µåˆ·æ–°ç›¸å…³å‚æ•°
```

> ğŸŒ **IOç“¶é¢ˆè¯Šæ–­**

```sql
-- é‡å¤æ‰§è¡Œå‡ æ¬¡SHOW ENGINE INNODB STATUS
-- è§‚å¯Ÿä»¥ä¸‹æŒ‡æ ‡å˜åŒ–ï¼š

Pending normal aio reads: X    # å¦‚æœæŒç»­>0ï¼Œè¯»IOæœ‰ç“¶é¢ˆ
Pending aio writes: Y          # å¦‚æœæŒç»­>0ï¼Œå†™IOæœ‰ç“¶é¢ˆ
Pages made young: Z            # LRUé“¾è¡¨é¡µé¢æ¢å…¥æƒ…å†µ
Pages not made young: W       # é¡µé¢è®¿é—®ä½†æœªç§»åŠ¨æƒ…å†µ

è¯Šæ–­æŠ€å·§ï¼š
â€¢ è¿ç»­è§‚å¯Ÿ3-5æ¬¡ï¼Œçœ‹è¶‹åŠ¿å˜åŒ–
â€¢ Pendingå€¼æŒç»­é«˜è¯´æ˜IOå‹åŠ›å¤§
â€¢ young/not youngæ¯”ä¾‹åæ˜ çƒ­ç‚¹æ•°æ®åˆ†å¸ƒ
```

---

## 4. ğŸ”§ sys schemaç›‘æ§è§†å›¾å®æˆ˜


### 4.1 sys schemaç®€ä»‹


**ğŸ“‹ ä»€ä¹ˆæ˜¯sys schema**
```
sys schemaï¼šMySQLæä¾›çš„ç®€åŒ–ç›‘æ§è§†å›¾é›†åˆ
ç‰¹ç‚¹ï¼š
â€¢ åŸºäºPerformance Schemaæ„å»º
â€¢ æä¾›æ›´æ˜“è¯»çš„ç›‘æ§è§†å›¾
â€¢ é¢„å®šä¹‰äº†å¸¸ç”¨çš„ç›‘æ§æŸ¥è¯¢
â€¢ é™ä½ç›‘æ§SQLç¼–å†™å¤æ‚åº¦

å°±åƒæ˜¯ï¼š
Performance Schema = æ±½è½¦å‘åŠ¨æœºçš„åŸå§‹ä¼ æ„Ÿå™¨æ•°æ®
sys schema = æ±½è½¦ä»ªè¡¨ç›˜çš„ç›´è§‚æ˜¾ç¤º

ä¼˜åŠ¿ï¼š
â€¢ æŸ¥è¯¢è¯­æ³•ç®€å•
â€¢ ç»“æœæ˜“äºç†è§£
â€¢ æ¶µç›–å¸¸è§ç›‘æ§åœºæ™¯
```

### 4.2 æ ¸å¿ƒç›‘æ§è§†å›¾


**ğŸ”¥ é‡è¦çš„sys schemaè§†å›¾**

> ğŸ“Š **æ€§èƒ½çƒ­ç‚¹åˆ†æ**

```sql
-- 1. æŸ¥çœ‹æœ€è€—æ—¶çš„SQLè¯­å¥
SELECT 
    query,
    exec_count,
    avg_latency,
    total_latency,
    lock_latency,
    rows_examined_avg,
    rows_sent_avg
FROM sys.statements_with_runtimes_in_95th_percentile 
LIMIT 10;

-- è¿™ä¸ªè§†å›¾æ˜¾ç¤ºæ‰§è¡Œæ—¶é—´åœ¨95åˆ†ä½æ•°ä»¥ä¸Šçš„SQL
-- å¸®åŠ©å¿«é€Ÿå®šä½æ€§èƒ½é—®é¢˜SQL
```

```sql
-- 2. åˆ†ææœ€æ¶ˆè€—IOçš„SQL
SELECT 
    query,
    exec_count,
    total_latency,
    avg_latency,
    lock_latency,
    rows_examined_avg
FROM sys.statements_with_sorting
ORDER BY total_latency DESC
LIMIT 10;

-- æ˜¾ç¤ºæ¶‰åŠæ’åºæ“ä½œçš„SQLè¯­å¥
-- æ’åºé€šå¸¸æ¯”è¾ƒè€—è´¹èµ„æº
```

> ğŸ”’ **é”å’Œç­‰å¾…åˆ†æ**

```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ
SELECT 
    r.trx_id AS waiting_trx_id,
    r.trx_mysql_thread_id AS waiting_thread,
    r.trx_query AS waiting_query,
    b.trx_id AS blocking_trx_id,
    b.trx_mysql_thread_id AS blocking_thread,
    b.trx_query AS blocking_query
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;

-- æ˜¾ç¤ºè°åœ¨ç­‰å¾…é”ï¼Œè°æŒæœ‰é”
-- å¸®åŠ©åˆ†æé”ç«äº‰é—®é¢˜
```

> ğŸ’¾ **å†…å­˜ä½¿ç”¨ç›‘æ§**

```sql
-- InnoDBç¼“å†²æ± ä½¿ç”¨æƒ…å†µ
SELECT 
    pool_id,
    pool_size,
    free_buffers,
    database_pages,
    old_database_pages,
    modified_database_pages,
    data_read,
    data_written
FROM information_schema.innodb_buffer_pool_stats;

-- å…³é”®æŒ‡æ ‡ï¼š
-- pool_size: ç¼“å†²æ± å¤§å°
-- free_buffers: ç©ºé—²é¡µé¢
-- modified_database_pages: è„é¡µæ•°é‡
```

### 4.3 sys schemaå®æˆ˜åº”ç”¨


**âš¡ æ—¥å¸¸ç›‘æ§è„šæœ¬**

> ğŸ” **æ€§èƒ½å¥åº·æ£€æŸ¥è„šæœ¬**

```sql
-- ç»¼åˆæ€§èƒ½æ£€æŸ¥è§†å›¾
SELECT 
    'Top 5 Slow Queries' AS check_type,
    NULL AS details
UNION ALL
SELECT 
    CONCAT('Query: ', LEFT(query, 50), '...'),
    CONCAT('Avg Time: ', avg_latency, ', Exec Count: ', exec_count)
FROM sys.statements_with_runtimes_in_95th_percentile 
LIMIT 5

UNION ALL
SELECT 
    'InnoDB Buffer Pool Status' AS check_type,
    NULL AS details
    
UNION ALL
SELECT 
    'Buffer Pool Hit Ratio',
    CONCAT(
        ROUND(
            (1 - (innodb_buffer_pool_reads / innodb_buffer_pool_read_requests)) * 100, 2
        ), '%'
    )
FROM 
    (SELECT variable_value AS innodb_buffer_pool_reads 
     FROM performance_schema.global_status 
     WHERE variable_name = 'Innodb_buffer_pool_reads') AS reads,
    (SELECT variable_value AS innodb_buffer_pool_read_requests 
     FROM performance_schema.global_status 
     WHERE variable_name = 'Innodb_buffer_pool_read_requests') AS requests;

-- è¿™ä¸ªè„šæœ¬æä¾›ç³»ç»Ÿå¥åº·çŠ¶å†µçš„å¿«é€Ÿæ¦‚è§ˆ
```

---

## 5. ğŸ“ˆ å…³é”®æ€§èƒ½æŒ‡æ ‡ç›‘æ§


### 5.1 æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ä½“ç³»


**ğŸ¯ InnoDBå…³é”®æŒ‡æ ‡åˆ†ç±»**
```
æ€§èƒ½æŒ‡æ ‡é‡‘å­—å¡”ï¼š
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ä¸šåŠ¡æŒ‡æ ‡    â”‚ â† å“åº”æ—¶é—´ã€ååé‡
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†‘
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  èµ„æºæŒ‡æ ‡    â”‚ â† CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†‘
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  å¼•æ“æŒ‡æ ‡    â”‚ â† ç¼“å†²æ± ã€é”ã€äº‹åŠ¡ã€IO
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®ç†è§£ï¼š
â€¢ å¼•æ“æŒ‡æ ‡æ˜¯åŸºç¡€ï¼Œå½±å“èµ„æºä½¿ç”¨
â€¢ èµ„æºæŒ‡æ ‡æ˜¯ä¸­å±‚ï¼Œå½±å“ä¸šåŠ¡æ€§èƒ½
â€¢ ä¸šåŠ¡æŒ‡æ ‡æ˜¯ç»“æœï¼Œåæ˜ ç”¨æˆ·ä½“éªŒ
```

### 5.2 ç¼“å†²æ± æ€§èƒ½æŒ‡æ ‡


**ğŸ’¾ ç¼“å†²æ± ç›‘æ§çš„æ ¸å¿ƒæŒ‡æ ‡**

> ğŸ”‘ **å‘½ä¸­ç‡ç›‘æ§**

```sql
-- è®¡ç®—ç¼“å†²æ± å‘½ä¸­ç‡
SELECT 
    ROUND(
        (1 - (
            SELECT variable_value 
            FROM performance_schema.global_status 
            WHERE variable_name = 'Innodb_buffer_pool_reads'
        ) / (
            SELECT variable_value 
            FROM performance_schema.global_status 
            WHERE variable_name = 'Innodb_buffer_pool_read_requests'
        )) * 100, 2
    ) AS buffer_pool_hit_ratio_percent;

-- å‘½ä¸­ç‡å«ä¹‰ï¼š
-- 99%ä»¥ä¸Šï¼šä¼˜ç§€ï¼Œç¼“å†²æ± å¤§å°åˆé€‚
-- 95-99%ï¼šè‰¯å¥½ï¼Œå¯èƒ½éœ€è¦é€‚å½“è°ƒæ•´
-- 90-95%ï¼šä¸€èˆ¬ï¼Œå»ºè®®å¢åŠ ç¼“å†²æ± å¤§å°
-- 90%ä»¥ä¸‹ï¼šè¾ƒå·®ï¼Œç¼“å†²æ± æ˜æ˜¾ä¸è¶³
```

> ğŸ“Š **è„é¡µæ¯”ä¾‹ç›‘æ§**

```sql
-- æŸ¥çœ‹è„é¡µæ¯”ä¾‹
SELECT 
    pool_size,
    database_pages,
    modified_database_pages,
    ROUND(
        (modified_database_pages / database_pages) * 100, 2
    ) AS dirty_pages_percent
FROM information_schema.innodb_buffer_pool_stats;

-- è„é¡µæ¯”ä¾‹å‚è€ƒå€¼ï¼š
-- 0-10%ï¼šæ­£å¸¸èŒƒå›´ï¼Œç³»ç»Ÿè¿è¡Œå¹³ç¨³
-- 10-25%ï¼šå¯æ¥å—ï¼Œä½†éœ€è¦å…³æ³¨å†™å…¥å‹åŠ›
-- 25-50%ï¼šåé«˜ï¼Œå¯èƒ½å½±å“æ€§èƒ½
-- 50%ä»¥ä¸Šï¼šè¿‡é«˜ï¼Œå­˜åœ¨æ€§èƒ½é£é™©
```

> âš¡ **æ¢å…¥æ¢å‡ºé¢‘ç‡**

```sql
-- ç›‘æ§é¡µé¢æ¢å…¥æ¢å‡ºæƒ…å†µ
SELECT 
    variable_name,
    variable_value,
    CASE 
        WHEN variable_name = 'Innodb_buffer_pool_pages_made_young' 
        THEN 'é¡µé¢ä»oldç§»åŠ¨åˆ°youngåŒºåŸŸçš„æ¬¡æ•°'
        WHEN variable_name = 'Innodb_buffer_pool_pages_not_made_young' 
        THEN 'é¡µé¢è®¿é—®ä½†æœªç§»åŠ¨çš„æ¬¡æ•°'
        WHEN variable_name = 'Innodb_buffer_pool_pages_made_young_rate' 
        THEN 'æ¯ç§’youngé¡µé¢ç§»åŠ¨ç‡'
    END AS description
FROM performance_schema.global_status 
WHERE variable_name IN (
    'Innodb_buffer_pool_pages_made_young',
    'Innodb_buffer_pool_pages_not_made_young',
    'Innodb_buffer_pool_pages_made_young_rate'
);

-- æ¢å…¥æ¢å‡ºé¢‘ç‡åˆ†æï¼š
-- youngç‡é«˜ï¼šçƒ­ç‚¹æ•°æ®è®¿é—®é¢‘ç¹ï¼Œæ­£å¸¸ç°è±¡
-- not youngç‡é«˜ï¼šå¯èƒ½å­˜åœ¨å…¨è¡¨æ‰«æç­‰é—®é¢˜
-- ä¸¤è€…æ¯”ä¾‹å¤±è¡¡ï¼šå¯èƒ½éœ€è¦è°ƒæ•´LRUå‚æ•°
```

### 5.3 IOæ€§èƒ½æŒ‡æ ‡


**ğŸ’¿ ç£ç›˜IOç›‘æ§æŒ‡æ ‡**

> ğŸ“ˆ **IOæ“ä½œç»Ÿè®¡**

```sql
-- æŸ¥çœ‹InnoDB IOæ“ä½œç»Ÿè®¡
SELECT 
    variable_name,
    variable_value,
    CASE 
        WHEN variable_name LIKE '%read%' THEN 'READæ“ä½œ'
        WHEN variable_name LIKE '%writ%' THEN 'WRITEæ“ä½œ'
        ELSE 'OTHERæ“ä½œ'
    END AS operation_type
FROM performance_schema.global_status 
WHERE variable_name LIKE 'Innodb%io%'
   OR variable_name LIKE 'Innodb%read%'
   OR variable_name LIKE 'Innodb%writ%'
ORDER BY operation_type, variable_name;

-- å…³é”®IOæŒ‡æ ‡ï¼š
-- Innodb_data_reads: æ•°æ®è¯»å–æ¬¡æ•°
-- Innodb_data_writes: æ•°æ®å†™å…¥æ¬¡æ•°  
-- Innodb_data_read: è¯»å–çš„å­—èŠ‚æ•°
-- Innodb_data_written: å†™å…¥çš„å­—èŠ‚æ•°
```

> ğŸ” **IOç­‰å¾…åˆ†æ**

```sql
-- åˆ†æIOç›¸å…³çš„ç­‰å¾…äº‹ä»¶
SELECT 
    event_name,
    count_star,
    sum_timer_wait/1000000000 AS total_wait_sec,
    avg_timer_wait/1000000000 AS avg_wait_sec
FROM performance_schema.events_waits_summary_global_by_event_name
WHERE event_name LIKE '%io%' 
  AND event_name LIKE '%innodb%'
ORDER BY sum_timer_wait DESC;

-- IOç­‰å¾…äº‹ä»¶å«ä¹‰ï¼š
-- wait/io/file/innodb/innodb_data_file: æ•°æ®æ–‡ä»¶IOç­‰å¾…
-- wait/io/file/innodb/innodb_log_file: æ—¥å¿—æ–‡ä»¶IOç­‰å¾…
-- wait/io/file/innodb/innodb_temp_file: ä¸´æ—¶æ–‡ä»¶IOç­‰å¾…
```

---

## 6. ğŸ§  å†…å­˜ä½¿ç”¨ç›‘æ§åˆ†æ


### 6.1 InnoDBå†…å­˜æ¶æ„ç›‘æ§


**ğŸ’­ å†…å­˜ä½¿ç”¨å…¨æ™¯å›¾**
```
InnoDBå†…å­˜åˆ†é…ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Buffer Pool         â”‚ â† æœ€å¤§å†…å­˜æ¶ˆè€—è€…
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚    Data Pages       â”‚   â”‚ â† ç¼“å­˜æ•°æ®é¡µ
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚    Index Pages      â”‚   â”‚ â† ç¼“å­˜ç´¢å¼•é¡µ
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚    Insert Buffer    â”‚   â”‚ â† æ’å…¥ç¼“å†²åŒº
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Log Buffer             â”‚ â† äº‹åŠ¡æ—¥å¿—ç¼“å†²
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Additional Memory Pool    â”‚ â† æ•°æ®å­—å…¸ç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç›‘æ§é‡ç‚¹ï¼š
â€¢ Buffer Poolä½¿ç”¨ç‡å’Œå‘½ä¸­ç‡
â€¢ Log Bufferçš„åˆ·æ–°é¢‘ç‡
â€¢ å†…å­˜åˆ†é…æ˜¯å¦åˆç†
```

### 6.2 å†…å­˜é—®é¢˜è¯Šæ–­æ–¹æ³•


**ğŸ” å†…å­˜ä½¿ç”¨å¼‚å¸¸è¯Šæ–­**

> ğŸš¨ **ç¼“å†²æ± ä¸è¶³è¯Šæ–­**

```sql
-- è¯Šæ–­ç¼“å†²æ± æ˜¯å¦è¶³å¤Ÿ
WITH buffer_stats AS (
    SELECT 
        variable_name,
        variable_value
    FROM performance_schema.global_status 
    WHERE variable_name IN (
        'Innodb_buffer_pool_read_requests',
        'Innodb_buffer_pool_reads',
        'Innodb_buffer_pool_pages_total',
        'Innodb_buffer_pool_pages_free',
        'Innodb_buffer_pool_pages_data'
    )
)
SELECT 
    'Buffer Pool Hit Ratio' AS metric,
    CONCAT(
        ROUND(
            (1 - (
                SELECT variable_value FROM buffer_stats WHERE variable_name = 'Innodb_buffer_pool_reads'
            ) / (
                SELECT variable_value FROM buffer_stats WHERE variable_name = 'Innodb_buffer_pool_read_requests'
            )) * 100, 2
        ), '%'
    ) AS value,
    CASE 
        WHEN (1 - (
            SELECT variable_value FROM buffer_stats WHERE variable_name = 'Innodb_buffer_pool_reads'
        ) / (
            SELECT variable_value FROM buffer_stats WHERE variable_name = 'Innodb_buffer_pool_read_requests'
        )) >= 0.99 THEN 'ä¼˜ç§€'
        WHEN (1 - (
            SELECT variable_value FROM buffer_stats WHERE variable_name = 'Innodb_buffer_pool_reads'
        ) / (
            SELECT variable_value FROM buffer_stats WHERE variable_name = 'Innodb_buffer_pool_read_requests'
        )) >= 0.95 THEN 'è‰¯å¥½'
        ELSE 'éœ€è¦ä¼˜åŒ–'
    END AS status

UNION ALL

SELECT 
    'Buffer Pool Usage' AS metric,
    CONCAT(
        ROUND(
            ((SELECT variable_value FROM buffer_stats WHERE variable_name = 'Innodb_buffer_pool_pages_data') / 
             (SELECT variable_value FROM buffer_stats WHERE variable_name = 'Innodb_buffer_pool_pages_total')) * 100, 2
        ), '%'
    ) AS value,
    'æ•°æ®é¡µå æ¯”' AS status;
```

> ğŸ“Š **å†…å­˜å‹åŠ›ç›‘æ§**

```sql
-- ç›‘æ§å†…å­˜å‹åŠ›æŒ‡æ ‡
SELECT 
    'Memory Pressure Indicators' AS category,
    '' AS metric,
    '' AS value
UNION ALL
SELECT 
    '',
    'Pages Made Young Rate',
    variable_value
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_buffer_pool_pages_made_young_rate'

UNION ALL
SELECT 
    '',
    'Pages Not Made Young Rate', 
    variable_value
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_buffer_pool_pages_not_made_young_rate'

UNION ALL  
SELECT 
    '',
    'Buffer Pool Wait Free',
    variable_value
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_buffer_pool_wait_free';

-- æŒ‡æ ‡å«ä¹‰ï¼š
-- Young Rateé«˜ï¼šçƒ­ç‚¹æ•°æ®é¢‘ç¹è®¿é—®ï¼Œå†…å­˜å‹åŠ›å¤§
-- Not Young Rateé«˜ï¼šå¯èƒ½å­˜åœ¨å¤§é‡æ‰«ææ“ä½œ
-- Wait Free > 0ï¼šç­‰å¾…ç©ºé—²é¡µé¢ï¼Œå†…å­˜å‹åŠ›å¾ˆå¤§
```

### 6.3 å†…å­˜ä¼˜åŒ–å»ºè®®


**âš¡ å†…å­˜è°ƒä¼˜ç­–ç•¥**

> ğŸ’¡ **ç¼“å†²æ± å¤§å°ä¼˜åŒ–**

```sql
-- è¯„ä¼°ç¼“å†²æ± å¤§å°æ˜¯å¦åˆé€‚
SET @total_memory_gb = (
    SELECT ROUND(
        (SELECT variable_value FROM performance_schema.global_variables 
         WHERE variable_name = 'innodb_buffer_pool_size') / 1024 / 1024 / 1024, 2
    )
);

SET @data_size_gb = (
    SELECT ROUND(SUM(data_length + index_length) / 1024 / 1024 / 1024, 2)
    FROM information_schema.tables 
    WHERE engine = 'InnoDB'
);

SELECT 
    @total_memory_gb AS current_buffer_pool_gb,
    @data_size_gb AS total_innodb_data_gb,
    CASE 
        WHEN @total_memory_gb >= @data_size_gb * 1.2 THEN 'ç¼“å†²æ± å……è¶³'
        WHEN @total_memory_gb >= @data_size_gb * 0.8 THEN 'ç¼“å†²æ± åˆé€‚'
        ELSE 'å»ºè®®å¢åŠ ç¼“å†²æ± '
    END AS recommendation,
    CONCAT(
        'å»ºè®®è®¾ç½®ä¸º: ', 
        GREATEST(ROUND(@data_size_gb * 1.2, 2), 1), 
        'GB'
    ) AS suggested_size;
```

> ğŸ”§ **å‚æ•°è°ƒä¼˜å»ºè®®**

```sql
-- å†…å­˜ç›¸å…³å‚æ•°æ£€æŸ¥
SELECT 
    variable_name,
    variable_value,
    CASE variable_name
        WHEN 'innodb_buffer_pool_size' THEN 
            CASE 
                WHEN CAST(variable_value AS UNSIGNED) < 1073741824 THEN 'å»ºè®®è‡³å°‘1GB'
                ELSE 'å½“å‰é…ç½®åˆç†'
            END
        WHEN 'innodb_log_buffer_size' THEN
            CASE 
                WHEN CAST(variable_value AS UNSIGNED) < 16777216 THEN 'å»ºè®®è‡³å°‘16MB'
                WHEN CAST(variable_value AS UNSIGNED) > 268435456 THEN 'å¯èƒ½è¿‡å¤§'
                ELSE 'å½“å‰é…ç½®åˆç†'
            END
        WHEN 'innodb_old_blocks_pct' THEN
            CASE 
                WHEN CAST(variable_value AS UNSIGNED) NOT BETWEEN 30 AND 40 THEN 'å»ºè®®è®¾ç½®ä¸º35å·¦å³'
                ELSE 'å½“å‰é…ç½®åˆç†'
            END
    END AS recommendation
FROM performance_schema.global_variables
WHERE variable_name IN (
    'innodb_buffer_pool_size',
    'innodb_log_buffer_size', 
    'innodb_old_blocks_pct',
    'innodb_old_blocks_time'
)
ORDER BY variable_name;
```

---

## 7. ğŸ’¿ IOæ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–


### 7.1 IOç›‘æ§ä½“ç³»


**ğŸ“Š IOæ€§èƒ½ç›‘æ§å±‚æ¬¡**
```
IOç›‘æ§çš„ä¸‰ä¸ªå±‚é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å±‚IO      â”‚ â†’ SQLæ‰§è¡Œäº§ç”Ÿçš„é€»è¾‘IO
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å­˜å‚¨å¼•æ“IO    â”‚ â†’ InnoDBçš„ç‰©ç†IOæ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç³»ç»Ÿå±‚IO      â”‚ â†’ æ“ä½œç³»ç»Ÿçš„ç£ç›˜IO
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®æŒ‡æ ‡å¯¹åº”å…³ç³»ï¼š
â€¢ åº”ç”¨å±‚ï¼šæŸ¥è¯¢æ‰«æè¡Œæ•°ã€è¿”å›è¡Œæ•°
â€¢ å­˜å‚¨å¼•æ“ï¼šé¡µè¯»å–æ•°é‡ã€é¡µå†™å…¥æ•°é‡  
â€¢ ç³»ç»Ÿå±‚ï¼šç£ç›˜è¯»å†™é€Ÿç‡ã€IOPSã€å»¶è¿Ÿ
```

### 7.2 InnoDB IOç›‘æ§æŒ‡æ ‡


**ğŸ” æ ¸å¿ƒIOæ€§èƒ½æŒ‡æ ‡**

> ğŸ“ˆ **IOæ“ä½œé‡ç›‘æ§**

```sql
-- ç›‘æ§InnoDB IOæ“ä½œç»Ÿè®¡
SELECT 
    'InnoDB IO Statistics' AS category,
    variable_name AS metric,
    variable_value AS current_value,
    CASE 
        WHEN variable_name LIKE '%read%' THEN 'è¯»æ“ä½œç›¸å…³'
        WHEN variable_name LIKE '%writ%' THEN 'å†™æ“ä½œç›¸å…³'
        WHEN variable_name LIKE '%flush%' THEN 'åˆ·æ–°æ“ä½œç›¸å…³'
        ELSE 'å…¶ä»–IOæ“ä½œ'
    END AS description
FROM performance_schema.global_status
WHERE variable_name IN (
    'Innodb_data_reads',           -- æ•°æ®è¯»å–æ¬¡æ•°
    'Innodb_data_writes',          -- æ•°æ®å†™å…¥æ¬¡æ•°  
    'Innodb_data_read',            -- è¯»å–å­—èŠ‚æ•°
    'Innodb_data_written',         -- å†™å…¥å­—èŠ‚æ•°
    'Innodb_buffer_pool_pages_flushed', -- åˆ·æ–°é¡µæ•°
    'Innodb_buffer_pool_read_requests',  -- é€»è¾‘è¯»è¯·æ±‚
    'Innodb_buffer_pool_reads'     -- ç‰©ç†è¯»æ¬¡æ•°
)
ORDER BY 
    CASE 
        WHEN variable_name LIKE '%read%' THEN 1
        WHEN variable_name LIKE '%writ%' THEN 2  
        ELSE 3
    END;
```

> â±ï¸ **IOå»¶è¿Ÿç›‘æ§**

```sql
-- åˆ†æIOç­‰å¾…æ—¶é—´
SELECT 
    event_name,
    count_star AS total_waits,
    ROUND(sum_timer_wait/1000000000, 2) AS total_wait_seconds,
    ROUND(avg_timer_wait/1000000000, 4) AS avg_wait_seconds,
    ROUND(max_timer_wait/1000000000, 4) AS max_wait_seconds
FROM performance_schema.events_waits_summary_global_by_event_name
WHERE event_name LIKE 'wait/io/file/innodb/%'
  AND count_star > 0
ORDER BY sum_timer_wait DESC;

-- IOå»¶è¿Ÿåˆ†æï¼š
-- avg_wait_seconds < 0.01: IOæ€§èƒ½ä¼˜ç§€
-- 0.01 - 0.05: IOæ€§èƒ½è‰¯å¥½
-- 0.05 - 0.1: IOæ€§èƒ½ä¸€èˆ¬ï¼Œéœ€è¦å…³æ³¨
-- > 0.1: IOæ€§èƒ½è¾ƒå·®ï¼Œéœ€è¦ä¼˜åŒ–
```

### 7.3 IOæ€§èƒ½é—®é¢˜è¯Šæ–­


**ğŸ› ï¸ å¸¸è§IOé—®é¢˜åˆ†æ**

> ğŸš¨ **IOç“¶é¢ˆè¯†åˆ«**

```sql
-- è¯†åˆ«IOç“¶é¢ˆçš„ç»¼åˆåˆ†æ
WITH io_metrics AS (
    SELECT 
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Innodb_data_reads') AS physical_reads,
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Innodb_buffer_pool_read_requests') AS logical_reads,
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Innodb_data_writes') AS data_writes,
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Innodb_log_writes') AS log_writes
)
SELECT 
    'IO Performance Analysis' AS analysis_type,
    '' AS metric,
    '' AS value,
    '' AS status
UNION ALL
SELECT 
    '',
    'Physical Read Ratio',
    CONCAT(ROUND((physical_reads / logical_reads) * 100, 2), '%'),
    CASE 
        WHEN (physical_reads / logical_reads) < 0.05 THEN 'ä¼˜ç§€'
        WHEN (physical_reads / logical_reads) < 0.10 THEN 'è‰¯å¥½'  
        WHEN (physical_reads / logical_reads) < 0.20 THEN 'ä¸€èˆ¬'
        ELSE 'è¾ƒå·®ï¼ŒIOå‹åŠ›å¤§'
    END
FROM io_metrics

UNION ALL
SELECT 
    '',
    'Write/Read Ratio',
    CONCAT(ROUND((data_writes / physical_reads), 2), ':1'),
    CASE 
        WHEN (data_writes / physical_reads) < 2 THEN 'è¯»å¤šå†™å°‘'
        WHEN (data_writes / physical_reads) < 5 THEN 'è¯»å†™å‡è¡¡'
        ELSE 'å†™å…¥å¯†é›†'
    END  
FROM io_metrics;
```

> ğŸ“Š **IOçƒ­ç‚¹æ–‡ä»¶åˆ†æ**

```sql
-- åˆ†æå“ªäº›æ–‡ä»¶IOæœ€ç¹å¿™
SELECT 
    file_name,
    event_name,
    count_read,
    count_write, 
    sum_number_of_bytes_read/1024/1024 AS read_mb,
    sum_number_of_bytes_write/1024/1024 AS write_mb,
    ROUND(sum_timer_read/1000000000, 2) AS read_wait_sec,
    ROUND(sum_timer_write/1000000000, 2) AS write_wait_sec
FROM performance_schema.file_summary_by_instance 
WHERE file_name LIKE '%ib%'  -- InnoDBç›¸å…³æ–‡ä»¶
   OR file_name LIKE '%ibd'  -- æ•°æ®æ–‡ä»¶
ORDER BY (sum_timer_read + sum_timer_write) DESC
LIMIT 10;

-- æ–‡ä»¶IOåˆ†æç»“æœè§£è¯»ï¼š
-- .ibdæ–‡ä»¶IOé«˜ï¼šè¡¨æ•°æ®è®¿é—®é¢‘ç¹
-- ibdata1æ–‡ä»¶IOé«˜ï¼šç³»ç»Ÿè¡¨ç©ºé—´è®¿é—®å¤š
-- ib_logfileæ–‡ä»¶IOé«˜ï¼šäº‹åŠ¡æ—¥å¿—å†™å…¥é¢‘ç¹
```

### 7.4 IOæ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**âš¡ IOä¼˜åŒ–å®æˆ˜æ–¹æ³•**

> ğŸ”§ **å‚æ•°è°ƒä¼˜**

```sql
-- IOç›¸å…³å‚æ•°æ£€æŸ¥å’Œå»ºè®®
SELECT 
    variable_name,
    variable_value,
    CASE variable_name
        WHEN 'innodb_io_capacity' THEN
            CASE 
                WHEN CAST(variable_value AS UNSIGNED) < 200 THEN 'å»ºè®®æé«˜åˆ°200-2000'
                WHEN CAST(variable_value AS UNSIGNED) > 10000 THEN 'å¯èƒ½è®¾ç½®è¿‡é«˜'
                ELSE 'å½“å‰é…ç½®åˆç†'
            END
        WHEN 'innodb_io_capacity_max' THEN
            CASE 
                WHEN CAST(variable_value AS UNSIGNED) / 
                     (SELECT CAST(variable_value AS UNSIGNED) 
                      FROM performance_schema.global_variables 
                      WHERE variable_name = 'innodb_io_capacity') < 2 
                THEN 'å»ºè®®è®¾ç½®ä¸ºio_capacityçš„2-10å€'
                ELSE 'å½“å‰é…ç½®åˆç†'
            END
        WHEN 'innodb_flush_method' THEN
            CASE 
                WHEN variable_value = 'O_DIRECT' THEN 'Linuxæ¨èé…ç½®'
                WHEN variable_value = 'fsync' THEN 'é»˜è®¤é…ç½®ï¼Œå¯è€ƒè™‘O_DIRECT'
                ELSE 'æ£€æŸ¥æ˜¯å¦é€‚åˆå½“å‰ç³»ç»Ÿ'
            END
    END AS recommendation
FROM performance_schema.global_variables
WHERE variable_name IN (
    'innodb_io_capacity',
    'innodb_io_capacity_max',
    'innodb_flush_method',
    'innodb_flush_neighbors',
    'sync_binlog'
)
ORDER BY variable_name;
```

> ğŸ’¡ **IOä¼˜åŒ–å»ºè®®**

```
ç¡¬ä»¶å±‚é¢ä¼˜åŒ–ï¼š
ğŸ”¸ ä½¿ç”¨SSDæ›¿ä»£æœºæ¢°ç¡¬ç›˜
ğŸ”¸ é…ç½®RAIDæé«˜å¹¶å‘æ€§èƒ½  
ğŸ”¸ å¢åŠ å†…å­˜å‡å°‘IOéœ€æ±‚
ğŸ”¸ ä½¿ç”¨é«˜é€Ÿç½‘ç»œå­˜å‚¨

è½¯ä»¶å±‚é¢ä¼˜åŒ–ï¼š
ğŸ”¸ è°ƒæ•´innodb_io_capacityåŒ¹é…ç£ç›˜æ€§èƒ½
ğŸ”¸ è®¾ç½®åˆé€‚çš„innodb_flush_method
ğŸ”¸ ä¼˜åŒ–SQLå‡å°‘ä¸å¿…è¦çš„IO
ğŸ”¸ å»ºç«‹åˆé€‚çš„ç´¢å¼•å‡å°‘æ‰«æ

ç³»ç»Ÿå±‚é¢ä¼˜åŒ–ï¼š
ğŸ”¸ è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå‚æ•°
ğŸ”¸ ä¼˜åŒ–æ“ä½œç³»ç»ŸIOè°ƒåº¦å™¨
ğŸ”¸ é…ç½®åˆé€‚çš„swappiness
ğŸ”¸ ç›‘æ§å’Œè°ƒæ•´ç£ç›˜é˜Ÿåˆ—æ·±åº¦
```

---

## 8. ğŸ”’ é”ç­‰å¾…ç›‘æ§è¯Šæ–­


### 8.1 InnoDBé”æœºåˆ¶ç›‘æ§


**ğŸ” é”ç›‘æ§çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆè¦ç›‘æ§é”ï¼š
â€¢ é”ç«äº‰ç›´æ¥å½±å“å¹¶å‘æ€§èƒ½
â€¢ æ­»é”ä¼šå¯¼è‡´äº‹åŠ¡å›æ»š
â€¢ é•¿æ—¶é—´é”ç­‰å¾…å½±å“ç”¨æˆ·ä½“éªŒ
â€¢ é”é—®é¢˜å¾€å¾€æ˜¯æ€§èƒ½ç“¶é¢ˆçš„æ ¹æº

é”ç›‘æ§çš„å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¡¨çº§é”ç›‘æ§     â”‚ â†’ å…ƒæ•°æ®é”ã€è¡¨é”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   è¡Œçº§é”ç›‘æ§     â”‚ â†’ è®°å½•é”ã€é—´éš™é”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å†…éƒ¨é”ç›‘æ§     â”‚ â†’ äº’æ–¥é”ã€è¯»å†™é”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 å®æ—¶é”ç­‰å¾…ç›‘æ§


**ğŸš¨ å½“å‰é”ç­‰å¾…æƒ…å†µåˆ†æ**

> ğŸ” **é”ç­‰å¾…è¯¦æƒ…æŸ¥è¯¢**

```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…çš„è¯¦ç»†ä¿¡æ¯
SELECT 
    r.trx_id AS waiting_trx_id,
    r.trx_mysql_thread_id AS waiting_thread,
    r.trx_query AS waiting_query,
    r.trx_operation_state AS waiting_operation,
    r.trx_tables_in_use AS waiting_tables_in_use,
    r.trx_tables_locked AS waiting_tables_locked,
    b.trx_id AS blocking_trx_id,
    b.trx_mysql_thread_id AS blocking_thread,
    b.trx_query AS blocking_query,
    b.trx_operation_state AS blocking_operation,
    l.lock_table AS locked_table,
    l.lock_index AS locked_index,
    l.lock_type AS lock_type,
    l.lock_mode AS lock_mode
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id  
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id
INNER JOIN information_schema.innodb_locks l ON l.lock_trx_id = w.blocking_trx_id;

-- æŸ¥è¯¢ç»“æœè§£è¯»ï¼š
-- waiting_query: æ­£åœ¨ç­‰å¾…çš„SQLè¯­å¥
-- blocking_query: æŒæœ‰é”çš„SQLè¯­å¥  
-- lock_type: é”ç±»å‹ï¼ˆRECORD/TABLEï¼‰
-- lock_mode: é”æ¨¡å¼ï¼ˆX/S/IX/ISç­‰ï¼‰
```

> â±ï¸ **é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡**

```sql
-- æ‰¾å‡ºé•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡ï¼ˆå¯èƒ½å¯¼è‡´é”ç­‰å¾…ï¼‰
SELECT 
    trx_id,
    trx_state,
    trx_started,
    trx_mysql_thread_id,
    trx_query,
    trx_operation_state,
    trx_tables_in_use,
    trx_tables_locked,
    trx_lock_structs,
    trx_rows_locked,
    trx_rows_modified,
    TIMESTAMPDIFF(SECOND, trx_started, NOW()) AS running_seconds
FROM information_schema.innodb_trx
WHERE trx_state = 'RUNNING'
  AND TIMESTAMPDIFF(SECOND, trx_started, NOW()) > 30  -- è¿è¡Œè¶…è¿‡30ç§’
ORDER BY running_seconds DESC;

-- å…³é”®æŒ‡æ ‡åˆ†æï¼š
-- running_seconds > 300: è¶…é•¿äº‹åŠ¡ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨
-- trx_rows_locked: é”å®šè¡Œæ•°ï¼Œè¶Šå¤šå½±å“è¶Šå¤§
-- trx_lock_structs: é”ç»“æ„æ•°é‡ï¼Œåæ˜ é”çš„å¤æ‚åº¦
```

### 8.3 æ­»é”ç›‘æ§ä¸åˆ†æ


**ğŸ’€ æ­»é”æ£€æµ‹ä¸åˆ†æ**

> ğŸ” **æœ€è¿‘æ­»é”ä¿¡æ¯**

```sql
-- æŸ¥çœ‹æœ€è¿‘çš„æ­»é”ä¿¡æ¯ï¼ˆéœ€è¦åœ¨SHOW ENGINE INNODB STATUSä¸­è·å–ï¼‰
-- è¿™é‡Œæä¾›ä¸€ä¸ªè„šæœ¬æ¥æå–æ­»é”ä¿¡æ¯
DELIMITER //
CREATE PROCEDURE analyze_deadlocks()
BEGIN
    DECLARE deadlock_info TEXT;
    
    -- è·å–InnoDBçŠ¶æ€ä¿¡æ¯
    SELECT 
        SUBSTRING(
            status, 
            LOCATE('LATEST DETECTED DEADLOCK', status),
            LOCATE('WE ROLL BACK TRANSACTION', status) - LOCATE('LATEST DETECTED DEADLOCK', status) + 30
        ) as deadlock_details
    FROM (
        SELECT variable_value as status 
        FROM information_schema.session_status 
        WHERE variable_name = 'Innodb_deadlocks'
    ) AS deadlock_status;
END //
DELIMITER ;

-- ç®€åŒ–çš„æ­»é”ç»Ÿè®¡æŸ¥è¯¢
SELECT 
    variable_name,
    variable_value,
    'ç´¯è®¡æ­»é”æ¬¡æ•°' AS description
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_deadlocks';
```

> ğŸ“Š **æ­»é”åˆ†æè„šæœ¬**

```sql
-- æ­»é”é£é™©è¯„ä¼°
SELECT 
    'Deadlock Risk Assessment' AS analysis_type,
    '' AS metric,
    '' AS value
UNION ALL
SELECT 
    '',
    'Total Deadlocks',
    variable_value
FROM performance_schema.global_status 
WHERE variable_name = 'Innodb_deadlocks'

UNION ALL
SELECT 
    '',
    'Current Lock Waits',
    CAST(COUNT(*) AS CHAR)
FROM information_schema.innodb_lock_waits

UNION ALL  
SELECT 
    '',
    'Long Running Transactions',
    CAST(COUNT(*) AS CHAR)
FROM information_schema.innodb_trx
WHERE TIMESTAMPDIFF(SECOND, trx_started, NOW()) > 60;
```

### 8.4 é”æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**âš¡ å‡å°‘é”ç«äº‰çš„æ–¹æ³•**

> ğŸ’¡ **åº”ç”¨å±‚ä¼˜åŒ–**

```
å‡å°‘é”ç«äº‰çš„ç¼–ç¨‹æŠ€å·§ï¼š

1. ç¼©çŸ­äº‹åŠ¡æ‰§è¡Œæ—¶é—´
   â€¢ é¿å…åœ¨äº‹åŠ¡ä¸­è¿›è¡Œé•¿æ—¶é—´è®¡ç®—
   â€¢ å‡å°‘äº‹åŠ¡ä¸­çš„ç½‘ç»œIOæ“ä½œ
   â€¢ ä¼˜åŒ–SQLè¯­å¥å‡å°‘æ‰§è¡Œæ—¶é—´

2. åˆç†çš„äº‹åŠ¡è¾¹ç•Œ
   â€¢ å°½é‡å°çš„äº‹åŠ¡ç²’åº¦
   â€¢ é¿å…è·¨ä¸šåŠ¡æ¨¡å—çš„å¤§äº‹åŠ¡
   â€¢ åŠæ—¶æäº¤æˆ–å›æ»šäº‹åŠ¡

3. è®¿é—®é¡ºåºä¼˜åŒ–
   â€¢ æŒ‰å›ºå®šé¡ºåºè®¿é—®è¡¨å’Œè¡Œ
   â€¢ é¿å…ä¸åŒäº‹åŠ¡çš„ç›¸åé¡ºåºè®¿é—®
   â€¢ ä½¿ç”¨ç›¸åŒçš„ç´¢å¼•è·¯å¾„è®¿é—®æ•°æ®
```

> ğŸ”§ **å‚æ•°è°ƒä¼˜**

```sql
-- é”ç›¸å…³å‚æ•°æ£€æŸ¥
SELECT 
    variable_name,
    variable_value,
    CASE variable_name
        WHEN 'innodb_lock_wait_timeout' THEN
            CASE 
                WHEN CAST(variable_value AS UNSIGNED) > 120 THEN 'è¶…æ—¶æ—¶é—´å¯èƒ½è¿‡é•¿'
                WHEN CAST(variable_value AS UNSIGNED) < 10 THEN 'è¶…æ—¶æ—¶é—´å¯èƒ½è¿‡çŸ­'
                ELSE 'å½“å‰é…ç½®åˆç†'
            END
        WHEN 'innodb_deadlock_detect' THEN
            CASE 
                WHEN variable_value = 'OFF' THEN 'å»ºè®®å¼€å¯æ­»é”æ£€æµ‹'
                ELSE 'å½“å‰é…ç½®åˆç†'
            END  
        WHEN 'innodb_print_all_deadlocks' THEN
            CASE 
                WHEN variable_value = 'OFF' THEN 'å»ºè®®å¼€å¯ä»¥ä¾¿åˆ†ææ­»é”'
                ELSE 'å½“å‰é…ç½®åˆç†'
            END
    END AS recommendation
FROM performance_schema.global_variables
WHERE variable_name IN (
    'innodb_lock_wait_timeout',
    'innodb_deadlock_detect', 
    'innodb_print_all_deadlocks',
    'transaction_isolation'
)
ORDER BY variable_name;
```

---

## 9. ğŸ“Š äº‹åŠ¡ç›‘æ§åˆ†æ


### 9.1 äº‹åŠ¡ç›‘æ§ä½“ç³»


**ğŸ“‹ äº‹åŠ¡ç›‘æ§çš„é‡è¦ç»´åº¦**
```
äº‹åŠ¡ç›‘æ§çš„å››ä¸ªæ ¸å¿ƒæ–¹é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº‹åŠ¡çŠ¶æ€ç›‘æ§   â”‚ â†’ æ´»è·ƒã€æäº¤ã€å›æ»šç»Ÿè®¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   äº‹åŠ¡æ‰§è¡Œç›‘æ§   â”‚ â†’ æ‰§è¡Œæ—¶é—´ã€å½±å“è¡Œæ•°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   äº‹åŠ¡èµ„æºç›‘æ§   â”‚ â†’ é”ä½¿ç”¨ã€å†…å­˜æ¶ˆè€—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   äº‹åŠ¡å†å²ç›‘æ§   â”‚ â†’ å†å²é•¿åº¦ã€æ¸…ç†æ•ˆç‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®ç†è§£ï¼š
â€¢ äº‹åŠ¡çŠ¶æ€åæ˜ ç³»ç»Ÿå¹¶å‘æƒ…å†µ
â€¢ æ‰§è¡Œç›‘æ§åæ˜ æ€§èƒ½æ•ˆç‡
â€¢ èµ„æºç›‘æ§åæ˜ ç³»ç»Ÿå‹åŠ›
â€¢ å†å²ç›‘æ§åæ˜ åƒåœ¾å›æ”¶æ•ˆç‡
```

### 9.2 äº‹åŠ¡çŠ¶æ€å®æ—¶ç›‘æ§


**ğŸ” å½“å‰äº‹åŠ¡çŠ¶æ€åˆ†æ**

> ğŸ“Š **æ´»è·ƒäº‹åŠ¡ç»Ÿè®¡**

```sql
-- å…¨é¢çš„äº‹åŠ¡çŠ¶æ€ç»Ÿè®¡
SELECT 
    'Transaction Status Overview' AS category,
    '' AS metric,
    '' AS count,
    '' AS description
    
UNION ALL
SELECT 
    '',
    'Total Active Transactions',
    CAST(COUNT(*) AS CHAR),
    'å½“å‰æ´»è·ƒäº‹åŠ¡æ€»æ•°'
FROM information_schema.innodb_trx

UNION ALL
SELECT 
    '',
    'Running Transactions', 
    CAST(COUNT(*) AS CHAR),
    'æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡'
FROM information_schema.innodb_trx 
WHERE trx_state = 'RUNNING'

UNION ALL
SELECT 
    '',
    'Lock Wait Transactions',
    CAST(COUNT(*) AS CHAR), 
    'ç­‰å¾…é”çš„äº‹åŠ¡'
FROM information_schema.innodb_trx
WHERE trx_state = 'LOCK WAIT'

UNION ALL
SELECT 
    '',
    'Long Running (>60s)',
    CAST(COUNT(*) AS CHAR),
    'é•¿æ—¶é—´è¿è¡Œäº‹åŠ¡'  
FROM information_schema.innodb_trx
WHERE TIMESTAMPDIFF(SECOND, trx_started, NOW()) > 60;
```

> â±ï¸ **äº‹åŠ¡æ‰§è¡Œæ—¶é—´åˆ†æ**

```sql
-- äº‹åŠ¡æ‰§è¡Œæ—¶é—´åˆ†å¸ƒåˆ†æ
SELECT 
    CASE 
        WHEN running_seconds <= 1 THEN '0-1ç§’'
        WHEN running_seconds <= 5 THEN '1-5ç§’'
        WHEN running_seconds <= 30 THEN '5-30ç§’'
        WHEN running_seconds <= 300 THEN '30ç§’-5åˆ†é’Ÿ'
        ELSE 'è¶…è¿‡5åˆ†é’Ÿ'
    END AS duration_range,
    COUNT(*) AS transaction_count,
    ROUND(AVG(trx_rows_locked), 0) AS avg_rows_locked,
    ROUND(AVG(trx_rows_modified), 0) AS avg_rows_modified
FROM (
    SELECT 
        trx_id,
        TIMESTAMPDIFF(SECOND, trx_started, NOW()) AS running_seconds,
        trx_rows_locked,
        trx_rows_modified
    FROM information_schema.innodb_trx
) AS transaction_stats
GROUP BY 
    CASE 
        WHEN running_seconds <= 1 THEN '0-1ç§’'
        WHEN running_seconds <= 5 THEN '1-5ç§’'
        WHEN running_seconds <= 30 THEN '5-30ç§’'
        WHEN running_seconds <= 300 THEN '30ç§’-5åˆ†é’Ÿ'
        ELSE 'è¶…è¿‡5åˆ†é’Ÿ'
    END
ORDER BY 
    MIN(running_seconds);
```

### 9.3 äº‹åŠ¡æ€§èƒ½æŒ‡æ ‡ç›‘æ§


**ğŸ“ˆ æ ¸å¿ƒäº‹åŠ¡æ€§èƒ½æŒ‡æ ‡**

> ğŸ”„ **äº‹åŠ¡å¤„ç†ç»Ÿè®¡**

```sql
-- äº‹åŠ¡å¤„ç†æ€§èƒ½ç»Ÿè®¡
SELECT 
    'Transaction Performance Metrics' AS category,
    variable_name AS metric,
    variable_value AS current_value,
    CASE 
        WHEN variable_name = 'Com_commit' THEN 'æˆåŠŸæäº¤çš„äº‹åŠ¡æ•°'
        WHEN variable_name = 'Com_rollback' THEN 'å›æ»šçš„äº‹åŠ¡æ•°'
        WHEN variable_name = 'Innodb_rows_read' THEN 'InnoDBè¯»å–çš„è¡Œæ•°'
        WHEN variable_name = 'Innodb_rows_inserted' THEN 'InnoDBæ’å…¥çš„è¡Œæ•°'
        WHEN variable_name = 'Innodb_rows_updated' THEN 'InnoDBæ›´æ–°çš„è¡Œæ•°'
        WHEN variable_name = 'Innodb_rows_deleted' THEN 'InnoDBåˆ é™¤çš„è¡Œæ•°'
    END AS description
FROM performance_schema.global_status
WHERE variable_name IN (
    'Com_commit',
    'Com_rollback', 
    'Innodb_rows_read',
    'Innodb_rows_inserted',
    'Innodb_rows_updated',
    'Innodb_rows_deleted'
)
ORDER BY variable_name;
```

> ğŸ“Š **äº‹åŠ¡å›æ»šç‡åˆ†æ**

```sql
-- è®¡ç®—äº‹åŠ¡å›æ»šç‡
WITH transaction_stats AS (
    SELECT 
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Com_commit') AS commits,
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Com_rollback') AS rollbacks
)
SELECT 
    'Transaction Success Rate Analysis' AS analysis,
    '' AS metric,
    '' AS value
UNION ALL
SELECT 
    '',
    'Total Commits',
    CAST(commits AS CHAR)
FROM transaction_stats
UNION ALL
SELECT 
    '',
    'Total Rollbacks', 
    CAST(rollbacks AS CHAR)
FROM transaction_stats
UNION ALL
SELECT 
    '',
    'Rollback Rate',
    CONCAT(
        ROUND((rollbacks / (commits + rollbacks)) * 100, 2), '%'
    )
FROM transaction_stats
UNION ALL
SELECT 
    '',
    'Success Rate',
    CONCAT(
        ROUND((commits / (commits + rollbacks)) * 100, 2), '%'  
    )
FROM transaction_stats;

-- å›æ»šç‡åˆ†æï¼š
-- < 1%: ä¼˜ç§€ï¼Œåº”ç”¨é€»è¾‘å¥åº·
-- 1-5%: è‰¯å¥½ï¼Œå¯æ¥å—èŒƒå›´
-- 5-10%: éœ€è¦å…³æ³¨ï¼Œå¯èƒ½å­˜åœ¨é€»è¾‘é—®é¢˜
-- > 10%: è¾ƒå·®ï¼Œéœ€è¦æ£€æŸ¥åº”ç”¨é€»è¾‘
```

### 9.4 äº‹åŠ¡å†å²é•¿åº¦ç›‘æ§


**ğŸ“œ å†å²ç‰ˆæœ¬ç›‘æ§**

> ğŸ” **History List Lengthåˆ†æ**

```sql
-- é€šè¿‡SHOW ENGINE INNODB STATUSè·å–History List Length
-- è¿™é‡Œæä¾›ä¸€ä¸ªè§£æè„šæœ¬çš„æ€è·¯
DELIMITER //
CREATE FUNCTION get_history_list_length() 
RETURNS INT
READS SQL DATA
BEGIN
    DECLARE result INT DEFAULT 0;
    -- è¿™é‡Œéœ€è¦è§£æSHOW ENGINE INNODB STATUSçš„è¾“å‡º
    -- å®é™…å®ç°ä¸­éœ€è¦ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¥å¤„ç†
    RETURN result;
END //
DELIMITER ;

-- ç®€åŒ–çš„ç›‘æ§æ–¹å¼ï¼šé€šè¿‡äº‹åŠ¡è¡¨ä¼°ç®—
SELECT 
    'Transaction History Analysis' AS analysis_type,
    '' AS metric,
    '' AS value
UNION ALL
SELECT 
    '',
    'Current Active Transactions',
    CAST(COUNT(*) AS CHAR)
FROM information_schema.innodb_trx
UNION ALL
SELECT 
    '',
    'Oldest Transaction Age',
    CONCAT(
        CAST(MAX(TIMESTAMPDIFF(SECOND, trx_started, NOW())) AS CHAR),
        ' seconds'
    )
FROM information_schema.innodb_trx
WHERE trx_started IS NOT NULL;
```

> âš ï¸ **å†å²é•¿åº¦è¿‡é•¿çš„å½±å“**

```
History List Lengthè¿‡é•¿çš„é—®é¢˜ï¼š

æ€§èƒ½å½±å“ï¼š
â€¢ å¢åŠ MVCCç‰ˆæœ¬é“¾éå†æ—¶é—´
â€¢ å ç”¨æ›´å¤šundo logç©ºé—´
â€¢ å½±å“purgeçº¿ç¨‹çš„æ¸…ç†æ•ˆç‡

ç›‘æ§å»ºè®®ï¼š
â€¢ History List Length < 1000: æ­£å¸¸
â€¢ 1000-10000: éœ€è¦å…³æ³¨
â€¢ > 10000: å­˜åœ¨æ€§èƒ½é£é™©

ä¼˜åŒ–æ–¹æ³•ï¼š
â€¢ é¿å…é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡
â€¢ åŠæ—¶æäº¤åªè¯»äº‹åŠ¡
â€¢ è°ƒæ•´purgeçº¿ç¨‹æ•°é‡
â€¢ ç›‘æ§å’Œæ¸…ç†åƒµå°¸äº‹åŠ¡
```

---

## 10. ğŸ¤– ç›‘æ§è‡ªåŠ¨åŒ–ä¸å‘Šè­¦


### 10.1 ç›‘æ§è‡ªåŠ¨åŒ–è„šæœ¬è®¾è®¡


**ğŸ“œ ç›‘æ§è„šæœ¬æ¶æ„**
```
ç›‘æ§è‡ªåŠ¨åŒ–çš„å±‚æ¬¡ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ•°æ®æ”¶é›†å±‚        â”‚ â†’ SQLè„šæœ¬ã€ç³»ç»Ÿå‘½ä»¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ•°æ®å¤„ç†å±‚        â”‚ â†’ è®¡ç®—æŒ‡æ ‡ã€é˜ˆå€¼æ¯”è¾ƒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    å­˜å‚¨å±•ç¤ºå±‚        â”‚ â†’ å†å²æ•°æ®ã€å›¾è¡¨å±•ç¤º
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    å‘Šè­¦é€šçŸ¥å±‚        â”‚ â†’ é‚®ä»¶ã€çŸ­ä¿¡ã€webhook
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è®¾è®¡åŸåˆ™ï¼š
â€¢ æ¨¡å—åŒ–ï¼šå„å±‚èŒè´£æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤
â€¢ å¯æ‰©å±•ï¼šæ”¯æŒæ–°å¢ç›‘æ§æŒ‡æ ‡
â€¢ é«˜å¯ç”¨ï¼šç›‘æ§ç³»ç»Ÿæœ¬èº«è¦ç¨³å®š
â€¢ ä½ä¾µå…¥ï¼šå¯¹æ•°æ®åº“æ€§èƒ½å½±å“æœ€å°
```

### 10.2 æ ¸å¿ƒç›‘æ§è„šæœ¬å®ç°


**ğŸ”§ ç›‘æ§æ•°æ®æ”¶é›†è„šæœ¬**

> ğŸ“Š **ç»¼åˆæ€§èƒ½ç›‘æ§è„šæœ¬**

```sql
-- åˆ›å»ºç›‘æ§æ•°æ®æ”¶é›†çš„å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE collect_innodb_metrics()
BEGIN
    -- å£°æ˜å˜é‡å­˜å‚¨ç›‘æ§æŒ‡æ ‡
    DECLARE buffer_pool_hit_rate DECIMAL(5,2);
    DECLARE dirty_pages_pct DECIMAL(5,2);
    DECLARE active_transactions INT;
    DECLARE lock_waits INT;
    DECLARE long_running_trx INT;
    
    -- è®¡ç®—ç¼“å†²æ± å‘½ä¸­ç‡
    SELECT 
        ROUND(
            (1 - (
                (SELECT variable_value FROM performance_schema.global_status 
                 WHERE variable_name = 'Innodb_buffer_pool_reads') /
                (SELECT variable_value FROM performance_schema.global_status 
                 WHERE variable_name = 'Innodb_buffer_pool_read_requests')
            )) * 100, 2
        ) INTO buffer_pool_hit_rate;
    
    -- è®¡ç®—è„é¡µæ¯”ä¾‹
    SELECT 
        ROUND(
            (modified_database_pages / database_pages) * 100, 2
        ) INTO dirty_pages_pct
    FROM information_schema.innodb_buffer_pool_stats
    LIMIT 1;
    
    -- ç»Ÿè®¡æ´»è·ƒäº‹åŠ¡æ•°
    SELECT COUNT(*) INTO active_transactions
    FROM information_schema.innodb_trx;
    
    -- ç»Ÿè®¡é”ç­‰å¾…æ•°
    SELECT COUNT(*) INTO lock_waits  
    FROM information_schema.innodb_lock_waits;
    
    -- ç»Ÿè®¡é•¿æ—¶é—´è¿è¡Œäº‹åŠ¡
    SELECT COUNT(*) INTO long_running_trx
    FROM information_schema.innodb_trx
    WHERE TIMESTAMPDIFF(SECOND, trx_started, NOW()) > 300;
    
    -- è¾“å‡ºç›‘æ§ç»“æœï¼ˆå®é™…åº”ç”¨ä¸­å¯ä»¥æ’å…¥åˆ°ç›‘æ§è¡¨ï¼‰
    SELECT 
        NOW() AS collect_time,
        buffer_pool_hit_rate,
        dirty_pages_pct,
        active_transactions,
        lock_waits,
        long_running_trx,
        CASE 
            WHEN buffer_pool_hit_rate < 95 THEN 'WARNING'
            WHEN dirty_pages_pct > 25 THEN 'WARNING'
            WHEN lock_waits > 5 THEN 'WARNING'
            WHEN long_running_trx > 0 THEN 'WARNING'
            ELSE 'OK'
        END AS overall_status;
        
END //
DELIMITER ;

-- ä½¿ç”¨ç›‘æ§è„šæœ¬
CALL collect_innodb_metrics();
```

### 10.3 å‘Šè­¦é˜ˆå€¼é…ç½®


**âš ï¸ ç›‘æ§å‘Šè­¦ç­–ç•¥**

> ğŸš¨ **å…³é”®æŒ‡æ ‡å‘Šè­¦é˜ˆå€¼**

```sql
-- åˆ›å»ºå‘Šè­¦é…ç½®è¡¨
CREATE TABLE innodb_alert_thresholds (
    metric_name VARCHAR(50) PRIMARY KEY,
    warning_threshold DECIMAL(10,2),
    critical_threshold DECIMAL(10,2),
    threshold_type ENUM('MIN', 'MAX'),
    alert_message TEXT
);

-- æ’å…¥å‘Šè­¦é˜ˆå€¼é…ç½®
INSERT INTO innodb_alert_thresholds VALUES
('buffer_pool_hit_rate', 95.00, 90.00, 'MIN', 'ç¼“å†²æ± å‘½ä¸­ç‡è¿‡ä½'),
('dirty_pages_pct', 25.00, 50.00, 'MAX', 'è„é¡µæ¯”ä¾‹è¿‡é«˜'),  
('active_transactions', 50, 100, 'MAX', 'æ´»è·ƒäº‹åŠ¡æ•°è¿‡å¤š'),
('lock_waits', 5, 20, 'MAX', 'é”ç­‰å¾…è¿‡å¤š'),
('long_running_trx', 0, 3, 'MAX', 'é•¿æ—¶é—´è¿è¡Œäº‹åŠ¡'),
('history_list_length', 1000, 10000, 'MAX', 'å†å²åˆ—è¡¨é•¿åº¦è¿‡é•¿');

-- å‘Šè­¦æ£€æŸ¥é€»è¾‘
SELECT 
    t.metric_name,
    t.warning_threshold,
    t.critical_threshold,
    CASE t.metric_name
        WHEN 'buffer_pool_hit_rate' THEN (
            SELECT ROUND((1 - (
                (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_reads') /
                (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_read_requests')
            )) * 100, 2)
        )
        WHEN 'active_transactions' THEN (
            SELECT COUNT(*) FROM information_schema.innodb_trx
        )
        WHEN 'lock_waits' THEN (
            SELECT COUNT(*) FROM information_schema.innodb_lock_waits
        )
    END AS current_value,
    t.alert_message
FROM innodb_alert_thresholds t;
```

### 10.4 è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬


**ğŸ¤– å®Œæ•´çš„è‡ªåŠ¨åŒ–ç›‘æ§è§£å†³æ–¹æ¡ˆ**

> ğŸ”§ **ç›‘æ§ä¸»è„šæœ¬**

```bash
#!/bin/bash
# InnoDBç›‘æ§è‡ªåŠ¨åŒ–è„šæœ¬
# innodb_monitor.sh

MYSQL_USER="monitor_user"
MYSQL_PASS="monitor_pass"
MYSQL_HOST="localhost"
ALERT_EMAIL="admin@company.com"
LOG_FILE="/var/log/innodb_monitor.log"

# è·å–å½“å‰æ—¶é—´æˆ³
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

# æ‰§è¡Œç›‘æ§SQLå¹¶è·å–ç»“æœ
monitor_innodb() {
    mysql -u$MYSQL_USER -p$MYSQL_PASS -h$MYSQL_HOST -e "
    SELECT 
        'BUFFER_POOL_HIT_RATE' AS metric,
        ROUND((1 - (
            (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_reads') /
            (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_read_requests')
        )) * 100, 2) AS value
    UNION ALL
    SELECT 
        'DIRTY_PAGES_PCT',
        ROUND((modified_database_pages / database_pages) * 100, 2)
    FROM information_schema.innodb_buffer_pool_stats LIMIT 1
    UNION ALL
    SELECT 
        'ACTIVE_TRANSACTIONS',
        COUNT(*)
    FROM information_schema.innodb_trx
    UNION ALL
    SELECT 
        'LOCK_WAITS', 
        COUNT(*)
    FROM information_schema.innodb_lock_waits;
    " 2>/dev/null
}

# æ£€æŸ¥å‘Šè­¦æ¡ä»¶
check_alerts() {
    local metrics=$(monitor_innodb)
    
    echo "$metrics" | while read line; do
        metric=$(echo $line | cut -f1)
        value=$(echo $line | cut -f2)
        
        case $metric in
            "BUFFER_POOL_HIT_RATE")
                if (( $(echo "$value < 95" | bc -l) )); then
                    send_alert "ç¼“å†²æ± å‘½ä¸­ç‡è¿‡ä½: $value%"
                fi
                ;;
            "DIRTY_PAGES_PCT") 
                if (( $(echo "$value > 25" | bc -l) )); then
                    send_alert "è„é¡µæ¯”ä¾‹è¿‡é«˜: $value%"
                fi
                ;;
            "LOCK_WAITS")
                if [[ $value -gt 5 ]]; then
                    send_alert "é”ç­‰å¾…è¿‡å¤š: $value ä¸ª"
                fi
                ;;
        esac
    done
}

# å‘é€å‘Šè­¦
send_alert() {
    local message="$1"
    echo "[$TIMESTAMP] ALERT: $message" >> $LOG_FILE
    echo "InnoDB Alert: $message" | mail -s "MySQL InnoDB Alert" $ALERT_EMAIL
}

# ä¸»æ‰§è¡Œé€»è¾‘
main() {
    echo "[$TIMESTAMP] Starting InnoDB monitoring..." >> $LOG_FILE
    check_alerts
    echo "[$TIMESTAMP] Monitoring completed." >> $LOG_FILE
}

# å¦‚æœç›´æ¥æ‰§è¡Œè„šæœ¬
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main
fi
```

---

## 11. ğŸ¯ è°ƒä¼˜å®æˆ˜æ¡ˆä¾‹


### 11.1 æ¡ˆä¾‹1ï¼šç¼“å†²æ± å‘½ä¸­ç‡ä½çš„é—®é¢˜


**ğŸ“‹ é—®é¢˜èƒŒæ™¯**
```
åœºæ™¯æè¿°ï¼š
â€¢ åº”ç”¨å“åº”æ—¶é—´çªç„¶å˜æ…¢
â€¢ æ•°æ®åº“æœåŠ¡å™¨IOä½¿ç”¨ç‡å¾ˆé«˜
â€¢ ç”¨æˆ·æŠ•è¯‰ç³»ç»Ÿå¡é¡¿

åˆæ­¥æ£€æŸ¥å‘ç°ï¼š
â€¢ ç¼“å†²æ± å‘½ä¸­ç‡ä»99%é™åˆ°85%
â€¢ ç£ç›˜è¯»å–æ“ä½œå¤§å¹…å¢åŠ 
â€¢ CPUç­‰å¾…IOæ—¶é—´è¿‡é•¿
```

**ğŸ” é—®é¢˜è¯Šæ–­è¿‡ç¨‹**

> **æ­¥éª¤1ï¼šç¡®è®¤ç¼“å†²æ± çŠ¶æ€**

```sql
-- æ£€æŸ¥ç¼“å†²æ± è¯¦ç»†çŠ¶æ€
SELECT 
    'Buffer Pool Diagnosis' AS analysis_step,
    'Metric' AS metric_name,
    'Value' AS metric_value,
    'Status' AS status

UNION ALL
SELECT 
    '',
    'Hit Rate',
    CONCAT(
        ROUND(
            (1 - (
                (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_reads') /
                (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_read_requests')
            )) * 100, 2
        ), '%'
    ),
    CASE 
        WHEN (1 - (
            (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_reads') /
            (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_read_requests')
        )) < 0.9 THEN 'ä¸¥é‡å¼‚å¸¸'
        WHEN (1 - (
            (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_reads') /
            (SELECT variable_value FROM performance_schema.global_status WHERE variable_name = 'Innodb_buffer_pool_read_requests')
        )) < 0.95 THEN 'éœ€è¦å…³æ³¨'
        ELSE 'æ­£å¸¸'
    END

UNION ALL
SELECT 
    '',
    'Pool Size',
    CONCAT(
        ROUND(
            (SELECT variable_value FROM performance_schema.global_variables 
             WHERE variable_name = 'innodb_buffer_pool_size') / 1024 / 1024 / 1024, 2
        ), 'GB'
    ),
    'å½“å‰ç¼“å†²æ± å¤§å°';
```

> **æ­¥éª¤2ï¼šåˆ†ææ•°æ®è®¿é—®æ¨¡å¼**

```sql
-- æŸ¥çœ‹æœ€è¿‘çš„å¤§é‡æ‰«ææ“ä½œ
SELECT 
    digest_text AS query_pattern,
    count_star AS exec_count,
    avg_rows_examined,
    avg_rows_sent, 
    ROUND(avg_rows_examined / GREATEST(avg_rows_sent, 1), 2) AS scan_efficiency,
    ROUND(sum_timer_wait / 1000000000, 2) AS total_time_sec
FROM performance_schema.events_statements_summary_by_digest
WHERE avg_rows_examined > 1000  -- æ‰«æè¡Œæ•°è¾ƒå¤šçš„æŸ¥è¯¢
  AND count_star > 10           -- æ‰§è¡Œæ¬¡æ•°è¾ƒå¤š
ORDER BY (avg_rows_examined * count_star) DESC  -- æ€»æ‰«æé‡æ’åº
LIMIT 10;

-- è¯Šæ–­å‘ç°ï¼š
-- æŸä¸ªæŠ¥è¡¨æŸ¥è¯¢çªç„¶å¼€å§‹å…¨è¡¨æ‰«æ
-- åŸå› ï¼šç´¢å¼•å¤±æ•ˆæˆ–ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸ
```

> **æ­¥éª¤3ï¼šåˆ¶å®šè§£å†³æ–¹æ¡ˆ**

```sql
-- è§£å†³æ–¹æ¡ˆæ‰§è¡Œè®°å½•
-- 1. æ£€æŸ¥é—®é¢˜SQLçš„æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM large_table WHERE some_column = 'value';

-- 2. æ£€æŸ¥ç´¢å¼•çŠ¶æ€  
SHOW INDEX FROM large_table;

-- 3. æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE large_table;

-- 4. é‡æ–°æ£€æŸ¥æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM large_table WHERE some_column = 'value';

-- 5. ç›‘æ§å‘½ä¸­ç‡æ¢å¤æƒ…å†µ
-- (é‡å¤æ‰§è¡Œç¼“å†²æ± å‘½ä¸­ç‡æŸ¥è¯¢)

è§£å†³æ•ˆæœï¼š
â€¢ å‘½ä¸­ç‡ä»85%æ¢å¤åˆ°99%
â€¢ IOä½¿ç”¨ç‡ä»80%é™åˆ°15%  
â€¢ åº”ç”¨å“åº”æ—¶é—´æ¢å¤æ­£å¸¸
```

### 11.2 æ¡ˆä¾‹2ï¼šé”ç­‰å¾…å¯¼è‡´çš„æ€§èƒ½é—®é¢˜


**ğŸ“‹ é—®é¢˜åœºæ™¯**
```
ä¸šåŠ¡ç°è±¡ï¼š
â€¢ æŸä¸ªä¸šåŠ¡åŠŸèƒ½çªç„¶å˜æ…¢
â€¢ ç”¨æˆ·æ“ä½œç»å¸¸è¶…æ—¶
â€¢ æ•°æ®åº“è¿æ¥æ•°æŒç»­å¢é•¿

æŠ€æœ¯ç°è±¡ï¼š
â€¢ SHOW PROCESSLISTæ˜¾ç¤ºå¤§é‡LockedçŠ¶æ€
â€¢ é”ç­‰å¾…è¶…æ—¶é”™è¯¯é¢‘ç¹å‡ºç°  
â€¢ CPUä½¿ç”¨ç‡ä¸é«˜ä½†å“åº”æ…¢
```

**ğŸ” é”é—®é¢˜è¯Šæ–­å®æˆ˜**

> **æ­¥éª¤1ï¼šåˆ†æå½“å‰é”ç­‰å¾…**

```sql
-- åˆ†æé”ç­‰å¾…çš„è¯¦ç»†æƒ…å†µ
SELECT 
    CONCAT('Thread-', r.trx_mysql_thread_id) AS waiting_thread,
    LEFT(r.trx_query, 100) AS waiting_query,
    TIMESTAMPDIFF(SECOND, r.trx_started, NOW()) AS wait_time_sec,
    CONCAT('Thread-', b.trx_mysql_thread_id) AS blocking_thread,
    LEFT(b.trx_query, 100) AS blocking_query,
    TIMESTAMPDIFF(SECOND, b.trx_started, NOW()) AS blocking_duration_sec,
    l.lock_table,
    l.lock_type,
    l.lock_mode
FROM information_schema.innodb_lock_waits w
JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id
JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id  
JOIN information_schema.innodb_locks l ON l.lock_trx_id = w.blocking_trx_id
ORDER BY wait_time_sec DESC;

-- è¯Šæ–­å‘ç°ï¼š
-- ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„æ›´æ–°äº‹åŠ¡é˜»å¡äº†å¤šä¸ªæŸ¥è¯¢
-- é˜»å¡äº‹åŠ¡å·²ç»è¿è¡Œäº†è¶…è¿‡10åˆ†é’Ÿ
-- é”å®šçš„æ˜¯æ ¸å¿ƒä¸šåŠ¡è¡¨çš„å¤šè¡Œè®°å½•
```

> **æ­¥éª¤2ï¼šåˆ†æé˜»å¡äº‹åŠ¡çš„æ ¹å› **

```sql
-- æ·±å…¥åˆ†æé˜»å¡äº‹åŠ¡
SELECT 
    trx_id,
    trx_state, 
    trx_operation_state,
    TIMESTAMPDIFF(SECOND, trx_started, NOW()) AS duration_seconds,
    trx_tables_in_use,
    trx_tables_locked,
    trx_lock_structs,
    trx_rows_locked,
    trx_rows_modified,
    LEFT(trx_query, 200) AS current_query
FROM information_schema.innodb_trx 
WHERE trx_mysql_thread_id = (
    -- è·å–é˜»å¡çº¿ç¨‹ID
    SELECT b.trx_mysql_thread_id 
    FROM information_schema.innodb_lock_waits w
    JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
    LIMIT 1
);

-- æ ¹å› åˆ†æï¼š
-- å‘ç°æ˜¯ä¸€ä¸ªæ‰¹é‡æ›´æ–°æ“ä½œæ²¡æœ‰æ­£ç¡®æäº¤
-- äº‹åŠ¡é”å®šäº†ä¸Šä¸‡è¡Œè®°å½•
-- åº”ç”¨ä»£ç ä¸­ç¼ºå°‘å¼‚å¸¸å¤„ç†å’Œäº‹åŠ¡æäº¤é€»è¾‘
```

> **æ­¥éª¤3ï¼šç´§æ€¥å¤„ç†å’Œé•¿æœŸä¼˜åŒ–**

```sql
-- ç´§æ€¥å¤„ç†ï¼šæ€æ‰é˜»å¡çš„é—®é¢˜äº‹åŠ¡
-- ï¼ˆéœ€è¦è°¨æ…æ“ä½œï¼Œç¡®è®¤åæœï¼‰
KILL 12345;  -- é˜»å¡çº¿ç¨‹çš„ID

-- é•¿æœŸä¼˜åŒ–æªæ–½ï¼š
-- 1. åº”ç”¨ä»£ç æ”¹è¿›
-- 2. å¢åŠ äº‹åŠ¡è¶…æ—¶ç›‘æ§
-- 3. ä¼˜åŒ–æ‰¹é‡æ“ä½œçš„äº‹åŠ¡ç²’åº¦

-- éªŒè¯å¤„ç†æ•ˆæœ
SELECT 
    'Post Fix Status' AS status_type,
    variable_name,
    variable_value
FROM performance_schema.global_status
WHERE variable_name IN (
    'Innodb_row_lock_waits',
    'Innodb_row_lock_time_avg',
    'Innodb_row_lock_time_max'
)
UNION ALL
SELECT 
    'Current Lock Waits',
    'Count',
    CAST(COUNT(*) AS CHAR)
FROM information_schema.innodb_lock_waits;
```

### 11.3 æ¡ˆä¾‹3ï¼šIOæ€§èƒ½ç“¶é¢ˆä¼˜åŒ–


**ğŸ“Š IOç“¶é¢ˆé—®é¢˜åˆ†æ**

> **é—®é¢˜ç°è±¡**

```
ä¸šåŠ¡ç°è±¡ï¼š
â€¢ æ•°æ®åº“æ•´ä½“å“åº”ç¼“æ…¢
â€¢ å†™å…¥æ“ä½œç‰¹åˆ«æ…¢
â€¢ ç³»ç»Ÿåœ¨ä¸šåŠ¡é«˜å³°æœŸç»å¸¸å¡é¡¿

ç›‘æ§æ•°æ®æ˜¾ç¤ºï¼š
â€¢ ç£ç›˜IOä½¿ç”¨ç‡æŒç»­90%ä»¥ä¸Š
â€¢ InnoDB pending writesæŒç»­ä¸ä¸º0
â€¢ è„é¡µæ¯”ä¾‹è¾¾åˆ°40-50%
```

> **è¯Šæ–­åˆ†æ**

```sql
-- IOç“¶é¢ˆè¯Šæ–­æŸ¥è¯¢
WITH io_analysis AS (
    SELECT 
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Innodb_data_writes') AS total_writes,
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Innodb_data_written') AS total_written_bytes,
        (SELECT variable_value FROM performance_schema.global_status 
         WHERE variable_name = 'Innodb_buffer_pool_pages_flushed') AS pages_flushed,
        (SELECT variable_value FROM performance_schema.global_variables
         WHERE variable_name = 'innodb_io_capacity') AS io_capacity,
        (SELECT modified_database_pages FROM information_schema.innodb_buffer_pool_stats LIMIT 1) AS dirty_pages,
        (SELECT database_pages FROM information_schema.innodb_buffer_pool_stats LIMIT 1) AS total_pages
)
SELECT 
    'IO Performance Diagnosis' AS analysis_type,
    'Metric' AS metric_name,
    'Value' AS metric_value,
    'Status' AS analysis_result

UNION ALL
SELECT 
    '',
    'Dirty Pages Ratio',
    CONCAT(ROUND((dirty_pages / total_pages) * 100, 2), '%'),
    CASE 
        WHEN (dirty_pages / total_pages) > 0.5 THEN 'CRITICAL - è„é¡µè¿‡å¤š'
        WHEN (dirty_pages / total_pages) > 0.25 THEN 'WARNING - éœ€è¦å…³æ³¨'
        ELSE 'OK'
    END
FROM io_analysis

UNION ALL
SELECT 
    '',
    'IO Capacity Setting',
    CAST(io_capacity AS CHAR),
    CASE 
        WHEN io_capacity < 200 THEN 'LOW - å»ºè®®æé«˜'
        WHEN io_capacity > 2000 THEN 'HIGH - æ£€æŸ¥æ˜¯å¦è¿‡é«˜'
        ELSE 'NORMAL'
    END  
FROM io_analysis

UNION ALL
SELECT 
    '',
    'Average Write Size', 
    CONCAT(ROUND(total_written_bytes / total_writes / 1024, 2), 'KB'),
    'IOæ“ä½œçš„å¹³å‡å¤§å°'
FROM io_analysis;
```

> **ä¼˜åŒ–æ–¹æ¡ˆå®æ–½**

```sql
-- IOä¼˜åŒ–å‚æ•°è°ƒæ•´
-- 1. æé«˜IOå®¹é‡è®¾ç½®
SET GLOBAL innodb_io_capacity = 1000;        -- æ ¹æ®ç¡¬ä»¶æ€§èƒ½è°ƒæ•´
SET GLOBAL innodb_io_capacity_max = 4000;    -- è®¾ç½®ä¸ºio_capacityçš„2-4å€

-- 2. è°ƒæ•´åˆ·æ–°ç­–ç•¥
SET GLOBAL innodb_max_dirty_pages_pct = 75;  -- é™ä½è„é¡µæ¯”ä¾‹é˜ˆå€¼
SET GLOBAL innodb_max_dirty_pages_pct_lwm = 50; -- è®¾ç½®ä½æ°´ä½æ ‡è®°

-- 3. ä¼˜åŒ–æ—¥å¿—å†™å…¥
SET GLOBAL innodb_flush_log_at_trx_commit = 2; -- æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´
SET GLOBAL sync_binlog = 0;                   -- å¦‚æœå¯ä»¥æ¥å—ä¸€å®šæ•°æ®ä¸¢å¤±é£é™©

-- 4. éªŒè¯ä¼˜åŒ–æ•ˆæœ
SELECT 
    'Optimization Results' AS result_type,
    variable_name,
    variable_value,
    'ä¼˜åŒ–åæ•°å€¼' AS note
FROM performance_schema.global_status
WHERE variable_name IN (
    'Innodb_buffer_pool_pages_dirty',
    'Innodb_buffer_pool_pages_flushed', 
    'Innodb_data_pending_writes'
)
ORDER BY variable_name;
```

### 11.4 ç»¼åˆè°ƒä¼˜æ•ˆæœè¯„ä¼°


**ğŸ“Š è°ƒä¼˜æ•ˆæœå¯¹æ¯”**

> ğŸ“ˆ **æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”**

```sql
-- å»ºç«‹æ€§èƒ½åŸºçº¿å¯¹æ¯”
CREATE TABLE performance_baseline (
    metric_name VARCHAR(50),
    before_value DECIMAL(15,2),
    after_value DECIMAL(15,2),
    improvement_pct DECIMAL(5,2),
    record_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- è®°å½•è°ƒä¼˜å‰åçš„å…³é”®æŒ‡æ ‡
INSERT INTO performance_baseline (metric_name, before_value, after_value, improvement_pct)
SELECT 
    'buffer_pool_hit_rate' AS metric_name,
    85.50 AS before_value,  -- è°ƒä¼˜å‰çš„å€¼
    99.20 AS after_value,   -- è°ƒä¼˜åçš„å€¼
    ROUND(((99.20 - 85.50) / 85.50) * 100, 2) AS improvement_pct

UNION ALL
SELECT 
    'avg_query_response_time',
    2.50,   -- è°ƒä¼˜å‰å¹³å‡2.5ç§’
    0.80,   -- è°ƒä¼˜åå¹³å‡0.8ç§’
    ROUND(((0.80 - 2.50) / 2.50) * 100, 2)  -- è´Ÿæ•°è¡¨ç¤ºæ”¹å–„

UNION ALL
SELECT 
    'dirty_pages_pct',
    45.00,  -- è°ƒä¼˜å‰45%
    15.00,  -- è°ƒä¼˜å15%
    ROUND(((15.00 - 45.00) / 45.00) * 100, 2)

UNION ALL
SELECT 
    'lock_wait_count',
    25.00,  -- è°ƒä¼˜å‰å¹³å‡25ä¸ªç­‰å¾…
    2.00,   -- è°ƒä¼˜åå¹³å‡2ä¸ªç­‰å¾…
    ROUND(((2.00 - 25.00) / 25.00) * 100, 2);

-- æŸ¥çœ‹è°ƒä¼˜æ•ˆæœæ€»ç»“
SELECT 
    metric_name,
    before_value,
    after_value,
    CONCAT(ABS(improvement_pct), '%') AS improvement,
    CASE 
        WHEN improvement_pct < -20 THEN 'æ˜¾è‘—æ”¹å–„'
        WHEN improvement_pct < -10 THEN 'æ˜æ˜¾æ”¹å–„'  
        WHEN improvement_pct < 0 THEN 'æœ‰æ‰€æ”¹å–„'
        ELSE 'éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–'
    END AS result_assessment
FROM performance_baseline
ORDER BY ABS(improvement_pct) DESC;
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ Performance Schemaï¼šMySQLå†…ç½®çš„å®æ—¶æ€§èƒ½ç›‘æ§æ¡†æ¶
ğŸ”¸ SHOW ENGINE INNODB STATUSï¼šInnoDBçŠ¶æ€çš„å®æ—¶å¿«ç…§å‘½ä»¤
ğŸ”¸ sys schemaï¼šç®€åŒ–ç‰ˆçš„ç›‘æ§è§†å›¾é›†åˆï¼Œä¾¿äºæ—¥å¸¸ä½¿ç”¨
ğŸ”¸ ç¼“å†²æ± å‘½ä¸­ç‡ï¼šè¡¡é‡å†…å­˜ä½¿ç”¨æ•ˆç‡çš„æ ¸å¿ƒæŒ‡æ ‡
ğŸ”¸ è„é¡µæ¯”ä¾‹ï¼šåæ˜ å†™å…¥å‹åŠ›å’Œåˆ·æ–°æ•ˆç‡çš„é‡è¦æŒ‡æ ‡
ğŸ”¸ é”ç­‰å¾…ç›‘æ§ï¼šè¯†åˆ«å¹¶å‘æ€§èƒ½ç“¶é¢ˆçš„å…³é”®æ‰‹æ®µ
ğŸ”¸ History List Lengthï¼šMVCCç‰ˆæœ¬ç®¡ç†æ•ˆç‡çš„æŒ‡ç¤ºå™¨
```

### 12.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§çš„æœ¬è´¨ç›®çš„**
```
ç›‘æ§ä¸æ˜¯ç›®çš„ï¼Œè€Œæ˜¯æ‰‹æ®µï¼š
â€¢ å‘ç°é—®é¢˜ï¼šé€šè¿‡æŒ‡æ ‡å¼‚å¸¸å‘ç°æ½œåœ¨é—®é¢˜
â€¢ åˆ†æåŸå› ï¼šé€šè¿‡è¯¦ç»†ç›‘æ§æ•°æ®æ‰¾åˆ°æ ¹å› 
â€¢ æŒ‡å¯¼ä¼˜åŒ–ï¼šä¸ºå‚æ•°è°ƒæ•´å’Œæ¶æ„æ”¹è¿›æä¾›ä¾æ®
â€¢ é¢„é˜²æ•…éšœï¼šåœ¨é—®é¢˜ä¸¥é‡åŒ–ä¹‹å‰åŠæ—¶å¤„ç†

ç›‘æ§çš„ä»·å€¼ï¼š
â€¢ ä»"è¢«åŠ¨å“åº”"åˆ°"ä¸»åŠ¨é¢„é˜²"
â€¢ ä»"ç»éªŒè°ƒä¼˜"åˆ°"æ•°æ®é©±åŠ¨"
â€¢ ä»"çŒœæµ‹é—®é¢˜"åˆ°"ç²¾ç¡®å®šä½"
```

**ğŸ”¹ ç›‘æ§æŒ‡æ ‡çš„å…³è”æ€§**
```
æŒ‡æ ‡é—´çš„å…³è”å…³ç³»ï¼š
ç¼“å†²æ± å‘½ä¸­ç‡ä½ â†’ IOå‹åŠ›å¢å¤§ â†’ å“åº”æ—¶é—´å»¶é•¿
è„é¡µæ¯”ä¾‹è¿‡é«˜ â†’ åˆ·æ–°é¢‘ç¹ â†’ IOç“¶é¢ˆ
äº‹åŠ¡è¿è¡Œè¿‡é•¿ â†’ é”ç«äº‰å¢åŠ  â†’ å¹¶å‘æ€§èƒ½ä¸‹é™
History Listè¿‡é•¿ â†’ MVCCå¼€é”€ â†’ æŸ¥è¯¢æ€§èƒ½ä¸‹é™

ç†è§£å…³è”æ€§çš„ä»·å€¼ï¼š
â€¢ é€šè¿‡ä¸€ä¸ªæŒ‡æ ‡å¼‚å¸¸æ¨æ–­å…¶ä»–å¯èƒ½çš„é—®é¢˜
â€¢ åˆ¶å®šç»¼åˆçš„ä¼˜åŒ–ç­–ç•¥è€Œä¸æ˜¯å•ç‚¹ä¼˜åŒ–
â€¢ é¢„æµ‹æŸä¸ªå˜æ›´å¯¹å…¶ä»–æŒ‡æ ‡çš„å½±å“
```

**ğŸ”¹ è‡ªåŠ¨åŒ–ç›‘æ§çš„é‡è¦æ€§**
```
äººå·¥ç›‘æ§ vs è‡ªåŠ¨åŒ–ç›‘æ§ï¼š
äººå·¥ç›‘æ§ï¼š
â€¢ ä¾èµ–äººçš„ç»éªŒå’Œè®°å¿†
â€¢ æ— æ³•7Ã—24å°æ—¶æŒç»­ç›‘æ§  
â€¢ å®¹æ˜“é—æ¼å…³é”®æ—¶åˆ»çš„å¼‚å¸¸
â€¢ å“åº”æ»åï¼Œé—®é¢˜å‘ç°è¾ƒæ™š

è‡ªåŠ¨åŒ–ç›‘æ§ï¼š
â€¢ åŸºäºæ•°æ®å’Œè§„åˆ™çš„å®¢è§‚åˆ¤æ–­
â€¢ æŒç»­ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
â€¢ å†å²æ•°æ®ç§¯ç´¯ï¼Œè¶‹åŠ¿åˆ†æ
â€¢ å¿«é€Ÿå“åº”ï¼Œå‡å°‘æ•…éšœå½±å“æ—¶é—´
```

### 12.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ› ï¸ æ—¥å¸¸ç›‘æ§å·¥ä½œæµç¨‹**
```
ç›‘æ§å·¥ä½œçš„æ ‡å‡†æµç¨‹ï¼š

æ—¥å¸¸æ£€æŸ¥ï¼ˆæ¯å¤©ï¼‰ï¼š
â‘  æŸ¥çœ‹å…³é”®æŒ‡æ ‡è¶‹åŠ¿
â‘¡ æ£€æŸ¥å‘Šè­¦æ—¥å¿—
â‘¢ åˆ†ææ…¢æŸ¥è¯¢ç»Ÿè®¡  
â‘£ æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ

å‘¨æœŸåˆ†æï¼ˆæ¯å‘¨ï¼‰ï¼š
â‘  æ€§èƒ½æŒ‡æ ‡è¶‹åŠ¿åˆ†æ
â‘¡ å®¹é‡è§„åˆ’è¯„ä¼°
â‘¢ å‚æ•°ä¼˜åŒ–æ•ˆæœè¯„ä¼°
â‘£ ç›‘æ§ä½“ç³»å®Œå–„

é—®é¢˜å¤„ç†ï¼ˆéšæ—¶ï¼‰ï¼š
â‘  å‘Šè­¦å“åº”å’Œé—®é¢˜å®šä½
â‘¡ ç´§æ€¥å¤„ç†å’Œå½±å“æ§åˆ¶
â‘¢ æ ¹å› åˆ†æå’Œè§£å†³æ–¹æ¡ˆ
â‘£ é¢„é˜²æªæ–½å’Œæµç¨‹æ”¹è¿›
```

**ğŸ“Š ç›‘æ§ä½“ç³»å»ºè®¾è·¯å¾„**

> ğŸ¯ **åˆ†é˜¶æ®µå»ºè®¾è®¡åˆ’**

```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç›‘æ§
â€¢ éƒ¨ç½²åŸºæœ¬çš„æŒ‡æ ‡æ”¶é›†
â€¢ å»ºç«‹æ ¸å¿ƒå‘Šè­¦è§„åˆ™
â€¢ æ­å»ºç®€å•çš„å±•ç¤ºç•Œé¢

ç¬¬äºŒé˜¶æ®µï¼šæ·±åº¦ç›‘æ§  
â€¢ å¢åŠ è¯¦ç»†çš„æ€§èƒ½åˆ†æ
â€¢ å»ºç«‹å†å²æ•°æ®å­˜å‚¨
â€¢ å®ç°è¶‹åŠ¿åˆ†æåŠŸèƒ½

ç¬¬ä¸‰é˜¶æ®µï¼šæ™ºèƒ½ç›‘æ§
â€¢ åŸºäºæœºå™¨å­¦ä¹ çš„å¼‚å¸¸æ£€æµ‹
â€¢ è‡ªåŠ¨åŒ–çš„æ ¹å› åˆ†æ
â€¢ é¢„æµ‹æ€§çš„å®¹é‡è§„åˆ’

å®æ–½å»ºè®®ï¼š
ğŸ”¸ ä»æ ¸å¿ƒæŒ‡æ ‡å¼€å§‹ï¼Œé€æ­¥æ‰©å±•
ğŸ”¸ é‡ç‚¹å…³æ³¨ä¸šåŠ¡å½±å“å¤§çš„æŒ‡æ ‡  
ğŸ”¸ å»ºç«‹ç›‘æ§æ•°æ®çš„æ ‡å‡†åŒ–å­˜å‚¨
ğŸ”¸ æŒç»­ä¼˜åŒ–å‘Šè­¦è§„åˆ™ï¼Œå‡å°‘è¯¯æŠ¥
```

### 12.4 è®°å¿†è¦ç‚¹å’Œæœ€ä½³å®è·µ


**ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**
```
InnoDBç›‘æ§è°ƒä¼˜æ­Œï¼š
ç›‘æ§å…ˆè¡Œæ•°æ®åº“ï¼ŒæŒ‡æ ‡å‘Šè­¦è¦æ¸…æ¥š
å‘½ä¸­ç‡é«˜æ€§èƒ½å¥½ï¼Œè„é¡µæ§åˆ¶åˆ«å¤ªå¤š
é”ç­‰æ­»é”è¦ç›‘æ§ï¼Œäº‹åŠ¡æ—¶é•¿æœ‰åˆ¶åº¦  
IOç“¶é¢ˆæŸ¥çƒ­ç‚¹ï¼Œå‚æ•°è°ƒä¼˜æ¸è¿›æ­¥
è‡ªåŠ¨åŒ–è„šæœ¬æ¥å¸®å¿™ï¼Œé—®é¢˜å®šä½ä¸ç³Šæ¶‚
åŸºçº¿å¯¹æ¯”çœ‹æ•ˆæœï¼ŒæŒç»­ä¼˜åŒ–æ˜¯å‡ºè·¯
```

**â­ å®æˆ˜æœ€ä½³å®è·µ**
```
ç›‘æ§å®æ–½çš„é»„é‡‘åŸåˆ™ï¼š

å…ˆç›‘æ§å†ä¼˜åŒ–ï¼š
â€¢ æ²¡æœ‰ç›‘æ§æ•°æ®å°±ä¸è¦ç›²ç›®è°ƒå‚æ•°
â€¢ å»ºç«‹æ€§èƒ½åŸºçº¿æ˜¯ä¼˜åŒ–çš„å‰æ
â€¢ æ¯æ¬¡è°ƒæ•´éƒ½è¦æœ‰æ•°æ®éªŒè¯æ•ˆæœ

é‡ç‚¹ç›‘æ§æ ¸å¿ƒæŒ‡æ ‡ï¼š
â€¢ ç¼“å†²æ± å‘½ä¸­ç‡ï¼ˆ>95%ï¼‰
â€¢ è„é¡µæ¯”ä¾‹ï¼ˆ<25%ï¼‰
â€¢ é”ç­‰å¾…æ•°é‡ï¼ˆ<5ä¸ªï¼‰
â€¢ é•¿äº‹åŠ¡æ•°é‡ï¼ˆ=0ä¸ªï¼‰

è‡ªåŠ¨åŒ–æ›¿ä»£äººå·¥ï¼š
â€¢ å®šæ—¶ç›‘æ§è„šæœ¬ï¼ˆæ¯5åˆ†é’Ÿï¼‰
â€¢ å®æ—¶å‘Šè­¦é€šçŸ¥ï¼ˆé‚®ä»¶+çŸ­ä¿¡ï¼‰
â€¢ è¶‹åŠ¿åˆ†ææŠ¥å‘Šï¼ˆæ¯å‘¨è‡ªåŠ¨ç”Ÿæˆï¼‰
â€¢ å¼‚å¸¸è‡ªåŠ¨è¯Šæ–­ï¼ˆæä¾›åˆæ­¥åˆ†æï¼‰

æŒç»­æ”¹è¿›ç›‘æ§ä½“ç³»ï¼š
â€¢ æ ¹æ®å®é™…é—®é¢˜è°ƒæ•´ç›‘æ§æŒ‡æ ‡
â€¢ ä¼˜åŒ–å‘Šè­¦é˜ˆå€¼å‡å°‘è¯¯æŠ¥
â€¢ å¢åŠ æ–°çš„ç›‘æ§ç»´åº¦
â€¢ ä¸ä¸šåŠ¡æŒ‡æ ‡å»ºç«‹å…³è”å…³ç³»
```

**ğŸ¯ å…³é”®æˆåŠŸå› ç´ **
- **ç›‘æ§è¦†ç›–é¢**ï¼šæ ¸å¿ƒæŒ‡æ ‡ä¸èƒ½é—æ¼ï¼Œä½†ä¹Ÿä¸è¦è¿‡äºå¤æ‚
- **å‘Šè­¦å‡†ç¡®æ€§**ï¼šå‡å°‘è¯¯æŠ¥ï¼Œæé«˜å‘Šè­¦çš„å¯ä¿¡åº¦
- **å“åº”åŠæ—¶æ€§**ï¼šä»å‘ç°é—®é¢˜åˆ°è§£å†³é—®é¢˜çš„æ—¶é—´è¦çŸ­
- **æŒç»­æ”¹è¿›**ï¼šæ ¹æ®å®é™…è¿ç»´ç»éªŒä¸æ–­ä¼˜åŒ–ç›‘æ§ç­–ç•¥
- **å›¢é˜Ÿåä½œ**ï¼šå»ºç«‹æ ‡å‡†çš„ç›‘æ§å’Œå¤„ç†æµç¨‹

**æ ¸å¿ƒè®°å¿†**ï¼šInnoDBç›‘æ§ä¸è°ƒä¼˜çš„æ ¸å¿ƒæ˜¯å»ºç«‹**æ•°æ®é©±åŠ¨**çš„è¿ç»´ä½“ç³»ï¼Œé€šè¿‡**å®æ—¶ç›‘æ§**å‘ç°é—®é¢˜ï¼Œé€šè¿‡**ç³»ç»Ÿåˆ†æ**æ‰¾åˆ°æ ¹å› ï¼Œé€šè¿‡**ç§‘å­¦è°ƒä¼˜**è§£å†³é—®é¢˜ï¼Œæœ€ç»ˆå®ç°æ•°æ®åº“çš„**ç¨³å®šé«˜æ•ˆ**è¿è¡Œã€‚