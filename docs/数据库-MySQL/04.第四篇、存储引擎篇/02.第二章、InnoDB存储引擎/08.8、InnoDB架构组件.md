---
title: 8ã€InnoDBæ¶æ„ç»„ä»¶
---
## ğŸ“š ç›®å½•

1. [InnoDBæ¶æ„æ¦‚è¿°](#1-innodbæ¶æ„æ¦‚è¿°)
2. [å†…å­˜ç»“æ„ç»„ä»¶](#2-å†…å­˜ç»“æ„ç»„ä»¶)
3. [ç£ç›˜æ–‡ä»¶ç»“æ„](#3-ç£ç›˜æ–‡ä»¶ç»“æ„)
4. [åå°çº¿ç¨‹ä½“ç³»](#4-åå°çº¿ç¨‹ä½“ç³»)
5. [ç¼“å†²æ± ç®¡ç†](#5-ç¼“å†²æ± ç®¡ç†)
6. [æ—¥å¿—ç³»ç»Ÿç»„ä»¶](#6-æ—¥å¿—ç³»ç»Ÿç»„ä»¶)
7. [é”ç®¡ç†å™¨](#7-é”ç®¡ç†å™¨)
8. [äº‹åŠ¡ç®¡ç†å™¨](#8-äº‹åŠ¡ç®¡ç†å™¨)
9. [å­˜å‚¨å¼•æ“æ¥å£](#9-å­˜å‚¨å¼•æ“æ¥å£)
10. [ç»„ä»¶åä½œæœºåˆ¶](#10-ç»„ä»¶åä½œæœºåˆ¶)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ InnoDBæ¶æ„æ¦‚è¿°


### 1.1 InnoDBæ¶æ„å…¨æ™¯å›¾


**ğŸ”¸ InnoDBæ•´ä½“æ¶æ„**
```
                    InnoDBå­˜å‚¨å¼•æ“æ¶æ„
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   MySQL Serverå±‚                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚   è¿æ¥å±‚     â”‚  â”‚   SQLå±‚      â”‚  â”‚   å­˜å‚¨å¼•æ“   â”‚  â”‚
    â”‚  â”‚             â”‚  â”‚             â”‚  â”‚    æ¥å£      â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 InnoDBå­˜å‚¨å¼•æ“                       â”‚
    â”‚                                                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚   å†…å­˜ç»“æ„   â”‚  â”‚   åå°çº¿ç¨‹   â”‚  â”‚   ç£ç›˜æ–‡ä»¶   â”‚  â”‚
    â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚
    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
    â”‚  â”‚ â”‚ç¼“å†²æ±     â”‚ â”‚  â”‚ â”‚Master   â”‚ â”‚  â”‚ â”‚è¡¨ç©ºé—´    â”‚ â”‚  â”‚
    â”‚  â”‚ â”‚         â”‚ â”‚  â”‚ â”‚Thread   â”‚ â”‚  â”‚ â”‚æ–‡ä»¶      â”‚ â”‚  â”‚
    â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚
    â”‚  â”‚ â”‚æ—¥å¿—ç¼“å†²  â”‚ â”‚  â”‚ â”‚IO       â”‚ â”‚  â”‚ â”‚é‡åšæ—¥å¿—  â”‚ â”‚  â”‚
    â”‚  â”‚ â”‚         â”‚ â”‚  â”‚ â”‚Thread   â”‚ â”‚  â”‚ â”‚æ–‡ä»¶      â”‚ â”‚  â”‚
    â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚
    â”‚  â”‚ â”‚é¢å¤–å†…å­˜æ± â”‚ â”‚  â”‚ â”‚Page     â”‚ â”‚  â”‚ â”‚æ’¤é”€æ—¥å¿—  â”‚ â”‚  â”‚
    â”‚  â”‚ â”‚         â”‚ â”‚  â”‚ â”‚Cleaner  â”‚ â”‚  â”‚ â”‚æ–‡ä»¶      â”‚ â”‚  â”‚
    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚
    â”‚  â”‚             â”‚  â”‚ â”‚Purge    â”‚ â”‚  â”‚ â”‚äºŒè¿›åˆ¶æ—¥å¿—â”‚ â”‚  â”‚
    â”‚  â”‚             â”‚  â”‚ â”‚Thread   â”‚ â”‚  â”‚ â”‚æ–‡ä»¶      â”‚ â”‚  â”‚
    â”‚  â”‚             â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¶æ„è®¾è®¡æ ¸å¿ƒæ€æƒ³


**ğŸ’¡ è®¾è®¡ç†å¿µ**
InnoDBçš„æ¶æ„è®¾è®¡éµå¾ªå‡ ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š

```
åˆ†å±‚è®¾è®¡ï¼š
- å†…å­˜å±‚ï¼šæä¾›é«˜é€Ÿç¼“å­˜å’Œä¸´æ—¶å­˜å‚¨
- çº¿ç¨‹å±‚ï¼šè´Ÿè´£åå°å¤„ç†å’Œç»´æŠ¤ä»»åŠ¡
- å­˜å‚¨å±‚ï¼šæä¾›æŒä¹…åŒ–æ•°æ®å­˜å‚¨

èŒè´£åˆ†ç¦»ï¼š
- æ¯ä¸ªç»„ä»¶éƒ½æœ‰æ˜ç¡®çš„èŒè´£
- ç»„ä»¶é—´é€šè¿‡æ ‡å‡†æ¥å£é€šä¿¡
- ä¾¿äºç»´æŠ¤å’Œæ‰©å±•

é«˜å¯ç”¨è®¾è®¡ï¼š
- å¤šç§å†—ä½™æœºåˆ¶ä¿è¯æ•°æ®å®‰å…¨
- æ•…éšœæ¢å¤æœºåˆ¶å®Œå–„
- æ”¯æŒåœ¨çº¿ç»´æŠ¤æ“ä½œ
```

### 1.3 ç»„ä»¶é—´å…³ç³»æ¦‚è§ˆ


**ğŸ”— ç»„ä»¶åä½œå…³ç³»**
```
æ•°æ®æµå‘ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ MySQL Serverå±‚ â†’ å­˜å‚¨å¼•æ“æ¥å£ â†’ InnoDBå†…å­˜ç»“æ„ â†’ åå°çº¿ç¨‹ â†’ ç£ç›˜æ–‡ä»¶

æ§åˆ¶æµå‘ï¼š
äº‹åŠ¡ç®¡ç†å™¨ â† â†’ é”ç®¡ç†å™¨ â† â†’ ç¼“å†²æ± ç®¡ç† â† â†’ æ—¥å¿—ç³»ç»Ÿ â† â†’ åå°çº¿ç¨‹

æ ¸å¿ƒäº¤äº’ï¼š
- äº‹åŠ¡è¯·æ±‚é€šè¿‡æ¥å£è¿›å…¥InnoDB
- ç¼“å†²æ± ç¼“å­˜çƒ­ç‚¹æ•°æ®é¡µ
- åå°çº¿ç¨‹è´Ÿè´£æ•°æ®åˆ·ç›˜å’Œç»´æŠ¤
- æ—¥å¿—ç³»ç»Ÿä¿è¯æ•°æ®ä¸€è‡´æ€§
```

---

## 2. ğŸ§  å†…å­˜ç»“æ„ç»„ä»¶


### 2.1 å†…å­˜ç»“æ„ç»„æˆ


**ğŸ“‹ InnoDBå†…å­˜æ¶æ„**
```
InnoDBå†…å­˜ç»“æ„ç»„æˆï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        InnoDBå†…å­˜æ±           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¼“å†²æ±  (Buffer Pool)       â”‚ â† æœ€é‡è¦ï¼Œå 80%å†…å­˜
â”‚  - æ•°æ®é¡µç¼“å­˜               â”‚
â”‚  - ç´¢å¼•é¡µç¼“å­˜               â”‚
â”‚  - æ’å…¥ç¼“å†²                 â”‚
â”‚  - è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é‡åšæ—¥å¿—ç¼“å†²              â”‚ â† äº‹åŠ¡æ—¥å¿—ä¸´æ—¶å­˜å‚¨
â”‚  (Redo Log Buffer)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢å¤–å†…å­˜æ±                 â”‚ â† ç®¡ç†ç»“æ„å­˜å‚¨
â”‚  (Additional Memory Pool)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç¼“å†²æ± è¯¦ç»†ç»“æ„


**ğŸ”¸ ç¼“å†²æ± æ ¸å¿ƒåŠŸèƒ½**
ç¼“å†²æ± æ˜¯InnoDBæœ€é‡è¦çš„å†…å­˜ç»„ä»¶ï¼Œç›¸å½“äºæ•°æ®åº“çš„"å†…å­˜ä»“åº“"ã€‚

```
ç¼“å†²æ± ä½œç”¨ï¼š
å°±åƒå›¾ä¹¦é¦†çš„é˜…è§ˆå®¤ï¼š
- æŠŠç»å¸¸ç”¨çš„ä¹¦æ”¾åœ¨æ‰‹è¾¹ï¼ˆçƒ­ç‚¹æ•°æ®é¡µï¼‰
- é¿å…æ¯æ¬¡éƒ½å»ä¹¦åº“æ‹¿ä¹¦ï¼ˆé¿å…ç£ç›˜IOï¼‰
- æä¾›ä¸´æ—¶å·¥ä½œåŒºåŸŸï¼ˆè„é¡µç¼“å­˜ï¼‰
- åŠ å¿«è¯»å†™é€Ÿåº¦
```

**ğŸ“Š ç¼“å†²æ± å†…éƒ¨ç»„æˆ**
```sql
-- æŸ¥çœ‹ç¼“å†²æ± çŠ¶æ€
SHOW STATUS LIKE 'Innodb_buffer_pool%';

-- ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š
-- æ•°æ®é¡µï¼ˆData Pagesï¼‰ï¼šå­˜å‚¨è¡¨æ•°æ®
-- ç´¢å¼•é¡µï¼ˆIndex Pagesï¼‰ï¼šå­˜å‚¨ç´¢å¼•æ•°æ®  
-- æ’å…¥ç¼“å†²ï¼ˆInsert Bufferï¼‰ï¼šä¼˜åŒ–éèšé›†ç´¢å¼•æ’å…¥
-- è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼ˆAdaptive Hash Indexï¼‰ï¼šåŠ é€Ÿç­‰å€¼æŸ¥è¯¢
-- é”ä¿¡æ¯ï¼ˆLock Infoï¼‰ï¼šäº‹åŠ¡é”ä¿¡æ¯
```

### 2.3 é‡åšæ—¥å¿—ç¼“å†²


**ğŸ“ æ—¥å¿—ç¼“å†²ä½œç”¨**
```
é‡åšæ—¥å¿—ç¼“å†² (Redo Log Buffer)ï¼š
ä½œç”¨ï¼šä¸´æ—¶å­˜å‚¨äº‹åŠ¡çš„é‡åšæ—¥å¿—è®°å½•
å¤§å°ï¼šç”± innodb_log_buffer_size å‚æ•°æ§åˆ¶
é»˜è®¤ï¼š16MB

å·¥ä½œåŸç†ï¼š
1. äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œå…ˆå†™å…¥æ—¥å¿—ç¼“å†²
2. å®šæœŸæˆ–è§¦å‘æ¡ä»¶æ—¶åˆ·æ–°åˆ°ç£ç›˜
3. ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼ˆDurabilityï¼‰
```

**âš™ï¸ æ—¥å¿—ç¼“å†²é…ç½®**
```sql
-- æŸ¥çœ‹å½“å‰é…ç½®
SELECT $$innodb_log_buffer_size / 1024 / 1024 as 'Log Buffer Size (MB)';

-- è°ƒæ•´æ—¥å¿—ç¼“å†²å¤§å°
SET GLOBAL innodb_log_buffer_size = 33554432;  -- 32MB

-- æ—¥å¿—åˆ·æ–°ç­–ç•¥
SELECT $$innodb_flush_log_at_trx_commit;
-- 0: æ¯ç§’åˆ·æ–°ä¸€æ¬¡
-- 1: æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶åˆ·æ–°ï¼ˆé»˜è®¤ï¼Œæœ€å®‰å…¨ï¼‰
-- 2: æ¯æ¬¡äº‹åŠ¡æäº¤å†™å…¥OSç¼“å†²ï¼Œæ¯ç§’åˆ·ç›˜
```

### 2.4 é¢å¤–å†…å­˜æ± 


**ğŸ”§ é¢å¤–å†…å­˜æ± è¯´æ˜**
```
é¢å¤–å†…å­˜æ±  (Additional Memory Pool)ï¼š
ä½œç”¨ï¼šå­˜å‚¨InnoDBå†…éƒ¨æ•°æ®ç»“æ„
å†…å®¹ï¼šç¼“å†²æ± çš„ç®¡ç†ä¿¡æ¯ã€é”ä¿¡æ¯ã€æ•°æ®å­—å…¸ç­‰
ç‰¹ç‚¹ï¼šç›¸å¯¹è¾ƒå°ï¼Œä¸€èˆ¬å‡ åMB

æ³¨æ„ï¼šMySQL 5.7.4åå·²åºŸå¼ƒæ­¤å‚æ•°
åŸå› ï¼šå†…å­˜ç®¡ç†ä¼˜åŒ–ï¼Œè‡ªåŠ¨åˆ†é…ç®¡ç†ç»“æ„å†…å­˜
```

---

## 3. ğŸ’¾ ç£ç›˜æ–‡ä»¶ç»“æ„


### 3.1 è¡¨ç©ºé—´æ–‡ä»¶ç³»ç»Ÿ


**ğŸ“ InnoDBæ–‡ä»¶ç»„ç»‡ç»“æ„**
```
InnoDBç£ç›˜æ–‡ä»¶ä½“ç³»ï¼š

æ•°æ®æ–‡ä»¶ï¼š
â”œâ”€â”€ ç³»ç»Ÿè¡¨ç©ºé—´ (ibdata1)          â† ç³»ç»Ÿä¿¡æ¯å’Œæ’¤é”€æ—¥å¿—
â”œâ”€â”€ ç‹¬ç«‹è¡¨ç©ºé—´ (table.ibd)        â† å•è¡¨æ•°æ®å’Œç´¢å¼•
â”œâ”€â”€ é€šç”¨è¡¨ç©ºé—´ (tablespace.ibd)   â† å¤šè¡¨å…±äº«ç©ºé—´
â””â”€â”€ ä¸´æ—¶è¡¨ç©ºé—´ (ibtmp1)          â† ä¸´æ—¶è¡¨æ•°æ®

æ—¥å¿—æ–‡ä»¶ï¼š
â”œâ”€â”€ é‡åšæ—¥å¿— (ib_logfile0/1)     â† äº‹åŠ¡é‡åšæ—¥å¿—
â”œâ”€â”€ æ’¤é”€æ—¥å¿— (undo tablespace)   â† äº‹åŠ¡æ’¤é”€ä¿¡æ¯
â””â”€â”€ äºŒè¿›åˆ¶æ—¥å¿— (mysql-bin)       â† å¤åˆ¶å’Œæ¢å¤ç”¨
```

### 3.2 ç³»ç»Ÿè¡¨ç©ºé—´è¯¦è§£


**ğŸ”¸ ç³»ç»Ÿè¡¨ç©ºé—´ (ibdata1)**
```sql
-- æŸ¥çœ‹ç³»ç»Ÿè¡¨ç©ºé—´é…ç½®
SELECT $$innodb_data_file_path;
-- å…¸å‹å€¼ï¼šibdata1:1G:autoextend

ç³»ç»Ÿè¡¨ç©ºé—´å†…å®¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®å­—å…¸ä¿¡æ¯    â”‚ â† InnoDBå†…éƒ¨å…ƒæ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚  æ’¤é”€æ®µä¿¡æ¯      â”‚ â† è€ç‰ˆæœ¬æ•°æ®å­˜å‚¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ’å…¥ç¼“å†²ç´¢å¼•    â”‚ â† Change Bufferç´¢å¼•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŒå†™ç¼“å†²åŒº      â”‚ â† æ•°æ®é¡µå®‰å…¨ä¿éšœ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æ•°æ®ï¼ˆå¯é€‰ï¼‰â”‚ â† å…³é—­ç‹¬ç«‹è¡¨ç©ºé—´æ—¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ç‹¬ç«‹è¡¨ç©ºé—´


**ğŸ“„ ç‹¬ç«‹è¡¨ç©ºé—´ (.ibdæ–‡ä»¶)**
```sql
-- å¼€å¯ç‹¬ç«‹è¡¨ç©ºé—´
SET GLOBAL innodb_file_per_table = ON;

-- æŸ¥çœ‹è¡¨ç©ºé—´å¤§å°
SELECT 
    table_schema,
    table_name,
    ROUND(data_length/1024/1024, 2) as 'Data Size (MB)',
    ROUND(index_length/1024/1024, 2) as 'Index Size (MB)'
FROM information_schema.tables 
WHERE engine = 'InnoDB' 
ORDER BY data_length DESC LIMIT 10;

ç‹¬ç«‹è¡¨ç©ºé—´ä¼˜åŠ¿ï¼š
âœ… è¡¨åˆ é™¤æ—¶ç©ºé—´ç«‹å³é‡Šæ”¾
âœ… å¯ä»¥å•è¡¨å¤‡ä»½å’Œæ¢å¤
âœ… æ”¯æŒè¡¨ç©ºé—´ä¼ è¾“
âœ… ä¾¿äºç©ºé—´ç›‘æ§å’Œç®¡ç†
```

### 3.4 æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ


**ğŸ“œ é‡åšæ—¥å¿—æ–‡ä»¶**
```sql
-- é‡åšæ—¥å¿—é…ç½®
SELECT $$innodb_log_file_size / 1024 / 1024 as 'Log File Size (MB)';
SELECT $$innodb_log_files_in_group as 'Log Files Count';

-- é‡åšæ—¥å¿—ä½¿ç”¨æƒ…å†µ
SHOW STATUS LIKE 'Innodb_log%';

é‡åšæ—¥å¿—ä½œç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº‹åŠ¡æäº¤æ—¶     â”‚ â†’ å…ˆå†™é‡åšæ—¥å¿—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç³»ç»Ÿå´©æºƒæ—¶     â”‚ â†’ ç”¨æ—¥å¿—æ¢å¤æ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   æ£€æŸ¥ç‚¹æ—¶       â”‚ â†’ æ ‡è®°å·²åˆ·ç›˜æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. âš¡ åå°çº¿ç¨‹ä½“ç³»


### 4.1 åå°çº¿ç¨‹æ¶æ„


**ğŸ”¸ InnoDBåå°çº¿ç¨‹ä½“ç³»**
```
InnoDBåå°çº¿ç¨‹æ¶æ„ï¼š

                Master Thread
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
   IO Thread    Page Cleaner  Purge Thread
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”‚         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚ Read    â”‚      â”‚         â”‚ Purge   â”‚
   â”‚ Thread  â”‚      â”‚         â”‚ Worker  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚         â”‚ Thread  â”‚
   â”‚ Write   â”‚      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ Thread  â”‚      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                    â”‚
              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
              â”‚ Page      â”‚
              â”‚ Cleaner   â”‚
              â”‚ Worker    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Master Threadä¸»çº¿ç¨‹


**ğŸ”¥ Master Threadæ ¸å¿ƒèŒè´£**
Master Threadæ˜¯InnoDBçš„"å¤§ç®¡å®¶"ï¼Œè´Ÿè´£åè°ƒå’Œç®¡ç†å„ç§åå°ä»»åŠ¡ã€‚

```
Master Threadä¸»è¦å·¥ä½œï¼š
1. ç¼“å†²æ± ç®¡ç†ï¼šå®šæœŸå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜
2. æ—¥å¿—ç®¡ç†ï¼šæ§åˆ¶é‡åšæ—¥å¿—çš„å†™å…¥å’Œåˆ·æ–°
3. æ’¤é”€ç®¡ç†ï¼šæ¸…ç†ä¸éœ€è¦çš„æ’¤é”€æ—¥å¿—
4. ç»Ÿè®¡ç»´æŠ¤ï¼šæ›´æ–°è¡¨å’Œç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯
5. ç©ºé—´ç®¡ç†ï¼šå›æ”¶å’Œæ•´ç†è¡¨ç©ºé—´

å·¥ä½œæ¨¡å¼ï¼š
- æ¯ç§’å¾ªç¯ï¼šå¤„ç†æ—¥å¿—åˆ·æ–°ã€è„é¡µåˆ·æ–°
- æ¯10ç§’å¾ªç¯ï¼šæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€æ¸…ç†æ“ä½œ
- ä¸»å¾ªç¯ï¼šæ ¹æ®ç³»ç»Ÿè´Ÿè½½è°ƒæ•´å·¥ä½œå¼ºåº¦
```

**âš™ï¸ Master Threadé…ç½®å‚æ•°**
```sql
-- Master Threadç›¸å…³å‚æ•°
SELECT $$innodb_max_dirty_pages_pct;      -- è„é¡µæ¯”ä¾‹é˜ˆå€¼ï¼š75%
SELECT $$innodb_adaptive_flushing;        -- è‡ªé€‚åº”åˆ·æ–°ï¼šON
SELECT $$innodb_io_capacity;              -- IOå®¹é‡ï¼š200
SELECT $$innodb_io_capacity_max;          -- æœ€å¤§IOå®¹é‡ï¼š2000

-- ç›‘æ§Master Threadå·¥ä½œçŠ¶æ€
SHOW STATUS LIKE 'Innodb_buffer_pool_pages_dirty';  -- è„é¡µæ•°é‡
SHOW STATUS LIKE 'Innodb_buffer_pool_pages_flushed'; -- å·²åˆ·æ–°é¡µæ•°
```

### 4.3 IO Threadè¯»å†™çº¿ç¨‹


**ğŸ”¥ IO Threadå·¥ä½œæœºåˆ¶**
IO Threadè´Ÿè´£å¤„ç†InnoDBçš„å¼‚æ­¥IOæ“ä½œï¼Œæé«˜ç£ç›˜æ“ä½œæ•ˆç‡ã€‚

```
IO Threadç»„æˆï¼š
- Read Threadï¼šå¤„ç†è¯»å–è¯·æ±‚
- Write Threadï¼šå¤„ç†å†™å…¥è¯·æ±‚
- Insert Buffer Threadï¼šå¤„ç†æ’å…¥ç¼“å†²åˆå¹¶
- Log Threadï¼šå¤„ç†æ—¥å¿—å†™å…¥

å·¥ä½œåŸç†ï¼š
ç”¨æˆ·çº¿ç¨‹ â†’ æäº¤IOè¯·æ±‚ â†’ IO Threadå¼‚æ­¥å¤„ç† â†’ é€šçŸ¥å®Œæˆ

å°±åƒå¿«é€’é…é€ç³»ç»Ÿï¼š
- ç”¨æˆ·ä¸‹å•ï¼ˆæäº¤IOè¯·æ±‚ï¼‰
- å¿«é€’å‘˜æ¥å•ï¼ˆIO Threadæ¥æ”¶ï¼‰
- å¼‚æ­¥é…é€ï¼ˆåå°å¤„ç†IOï¼‰
- é…é€å®Œæˆé€šçŸ¥ï¼ˆIOå®Œæˆå›è°ƒï¼‰
```

**âš™ï¸ IO Threadé…ç½®**
```sql
-- IOçº¿ç¨‹æ•°é‡é…ç½®
SELECT $$innodb_read_io_threads;   -- è¯»IOçº¿ç¨‹æ•°ï¼š4
SELECT $$innodb_write_io_threads;  -- å†™IOçº¿ç¨‹æ•°ï¼š4

-- ç›‘æ§IOçº¿ç¨‹çŠ¶æ€
SHOW ENGINE INNODB STATUS\G

-- åœ¨è¾“å‡ºä¸­æŸ¥æ‰¾ï¼š
-- FILE I/O
-- I/O thread 0 state: waiting for completed aio requests
-- I/O thread 1 state: waiting for completed aio requests
```

### 4.4 Page Cleaner Thread


**ğŸ”¥ Page Cleaner Threadæ¸…ç†æœºåˆ¶**
Page Cleaner Threadä¸“é—¨è´Ÿè´£å°†ç¼“å†²æ± ä¸­çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜ã€‚

```
Page Cleanerå·¥ä½œèŒè´£ï¼š
1. è„é¡µåˆ·æ–°ï¼šå°†ä¿®æ”¹è¿‡çš„æ•°æ®é¡µå†™å…¥ç£ç›˜
2. æ£€æŸ¥ç‚¹ï¼šåˆ›å»ºæ£€æŸ¥ç‚¹ï¼Œæ ‡è®°æ•°æ®ä¸€è‡´æ€§ä½ç½®
3. è‡ªé€‚åº”åˆ·æ–°ï¼šæ ¹æ®ç³»ç»Ÿè´Ÿè½½è°ƒæ•´åˆ·æ–°é€Ÿåº¦
4. æ‰¹é‡æ“ä½œï¼šæ‰¹é‡åˆ·æ–°æé«˜æ•ˆç‡

åˆ·æ–°è§¦å‘æ¡ä»¶ï¼š
- è„é¡µæ¯”ä¾‹è¶…è¿‡é˜ˆå€¼
- é‡åšæ—¥å¿—ç©ºé—´ä¸è¶³
- ç¼“å†²æ± ç©ºé—´ä¸è¶³
- å®šæœŸåˆ·æ–°ï¼ˆæ¯ç§’ï¼‰
```

**ğŸ“Š Page Cleanerç›‘æ§**
```sql
-- Page Cleanerå·¥ä½œçŠ¶æ€
SELECT 
    VARIABLE_NAME,
    VARIABLE_VALUE
FROM performance_schema.global_status 
WHERE VARIABLE_NAME IN (
    'Innodb_buffer_pool_pages_dirty',      -- å½“å‰è„é¡µæ•°
    'Innodb_buffer_pool_pages_flushed',    -- å·²åˆ·æ–°é¡µæ•°
    'Innodb_pages_written',                -- å†™å…¥é¡µæ€»æ•°
    'Innodb_page_cleaners_active'          -- æ´»è·ƒæ¸…ç†çº¿ç¨‹æ•°
);

-- Page Cleaneré…ç½®å‚æ•°
SELECT $$innodb_page_cleaners;             -- æ¸…ç†çº¿ç¨‹æ•°ï¼š4
SELECT $$innodb_max_dirty_pages_pct;       -- æœ€å¤§è„é¡µæ¯”ä¾‹ï¼š90%
SELECT $$innodb_max_dirty_pages_pct_lwm;   -- è„é¡µåˆ·æ–°ä½æ°´ä½ï¼š10%
```

### 4.5 Purge Threadæ¸…ç†çº¿ç¨‹


**ğŸ”¥ Purge Threadåƒåœ¾å›æ”¶**
Purge Threadè´Ÿè´£æ¸…ç†å·²ç»ä¸å†éœ€è¦çš„æ’¤é”€æ—¥å¿—å’Œå†å²ç‰ˆæœ¬æ•°æ®ã€‚

```
Purge Threadå·¥ä½œå†…å®¹ï¼š
1. æ’¤é”€æ—¥å¿—æ¸…ç†ï¼šåˆ é™¤å·²æäº¤äº‹åŠ¡çš„æ’¤é”€ä¿¡æ¯
2. å†å²ç‰ˆæœ¬æ¸…ç†ï¼šæ¸…ç†MVCCäº§ç”Ÿçš„æ—§ç‰ˆæœ¬æ•°æ®
3. ç©ºé—´å›æ”¶ï¼šå›æ”¶è¢«æ ‡è®°åˆ é™¤çš„è®°å½•ç©ºé—´
4. ç´¢å¼•ç»´æŠ¤ï¼šæ¸…ç†ç´¢å¼•ä¸­çš„åˆ é™¤æ ‡è®°

æ¸…ç†æ—¶æœºï¼š
- äº‹åŠ¡æäº¤å
- æ²¡æœ‰æ›´æ—©çš„æ´»è·ƒäº‹åŠ¡æ—¶
- ç³»ç»Ÿç©ºé—²æ—¶
- æ’¤é”€æ—¥å¿—ç©ºé—´ç´§å¼ æ—¶
```

**ğŸ”§ Purge Threadé…ç½®å’Œç›‘æ§**
```sql
-- Purgeçº¿ç¨‹é…ç½®
SELECT $$innodb_purge_threads;         -- Purgeçº¿ç¨‹æ•°ï¼š4
SELECT $$innodb_max_purge_lag;         -- æœ€å¤§Purgeæ»åï¼š0

-- ç›‘æ§Purgeå·¥ä½œçŠ¶æ€
SHOW STATUS LIKE 'Innodb_purge%';

-- å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š
-- Innodb_purge_trx_id_ageï¼šéœ€è¦æ¸…ç†çš„äº‹åŠ¡å¹´é¾„
-- Innodb_purge_undo_noï¼šå·²æ¸…ç†çš„æ’¤é”€è®°å½•æ•°
```

---

## 5. ğŸ—„ï¸ ç¼“å†²æ± ç®¡ç†


### 5.1 ç¼“å†²æ± ç®¡ç†æœºåˆ¶


**ğŸ’¡ ç¼“å†²æ± æ˜¯å¦‚ä½•å·¥ä½œçš„**
ç¼“å†²æ± ä½¿ç”¨LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•ç®¡ç†å†…å­˜é¡µé¢ï¼Œä½†InnoDBå¯¹æ ‡å‡†LRUè¿›è¡Œäº†é‡è¦æ”¹è¿›ã€‚

```
InnoDBæ”¹è¿›çš„LRUç®—æ³•ï¼š

æ ‡å‡†LRUé—®é¢˜ï¼š
- å…¨è¡¨æ‰«æä¼šæ±¡æŸ“ç¼“å­˜
- çƒ­ç‚¹æ•°æ®å¯èƒ½è¢«æŒ¤å‡ºç¼“å­˜

InnoDB LRUæ”¹è¿›ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    NewåŒºåŸŸ      â”‚ â† æ–°è¯»å…¥çš„é¡µé¢å…ˆæ”¾è¿™é‡Œ
â”‚   (çº¦37%)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    OldåŒºåŸŸ      â”‚ â† è€çš„é¡µé¢åœ¨è¿™é‡Œ
â”‚   (çº¦63%)       â”‚   
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœºåˆ¶ï¼š
- æ–°é¡µé¢å…ˆè¿›å…¥OldåŒºåŸŸçš„å¤´éƒ¨
- å†æ¬¡è®¿é—®ä¸”é—´éš”è¶…è¿‡1ç§’ï¼Œæ‰ç§»åˆ°NewåŒºåŸŸ
- é¿å…å…¨è¡¨æ‰«ææ±¡æŸ“çƒ­ç‚¹æ•°æ®
```

### 5.2 ç¼“å†²æ± æ ¸å¿ƒå‚æ•°


**âš™ï¸ å…³é”®é…ç½®å‚æ•°**
```sql
-- ç¼“å†²æ± å¤§å°ï¼ˆæœ€é‡è¦å‚æ•°ï¼‰
SELECT $$innodb_buffer_pool_size / 1024 / 1024 / 1024 as 'Buffer Pool Size (GB)';
-- å»ºè®®ï¼šæœåŠ¡å™¨å†…å­˜çš„60-80%

-- ç¼“å†²æ± å®ä¾‹æ•°
SELECT $$innodb_buffer_pool_instances;
-- å»ºè®®ï¼šæ¯ä¸ªå®ä¾‹1GBï¼Œæ€»å¤§å°/1GB = å®ä¾‹æ•°

-- LRUç®—æ³•å‚æ•°
SELECT $$innodb_old_blocks_pct;        -- OldåŒºåŸŸå æ¯”ï¼š37%
SELECT $$innodb_old_blocks_time;       -- é¡µé¢æå‡ç­‰å¾…æ—¶é—´ï¼š1000ms

-- é¢„è¯»å‚æ•°
SELECT $$innodb_read_ahead_threshold;  -- é¢„è¯»é˜ˆå€¼ï¼š56
SELECT $$innodb_random_read_ahead;     -- éšæœºé¢„è¯»ï¼šOFF
```

### 5.3 ç¼“å†²æ± æ€§èƒ½ç›‘æ§


**ğŸ“Š ç¼“å†²æ± æ•ˆç‡æŒ‡æ ‡**
```sql
-- ç¼“å†²æ± å‘½ä¸­ç‡ï¼ˆæœ€é‡è¦æŒ‡æ ‡ï¼‰
SELECT 
    (1 - (Innodb_buffer_pool_reads / Innodb_buffer_pool_read_requests)) * 100 as hit_ratio_percent
FROM 
    (SELECT VARIABLE_VALUE as Innodb_buffer_pool_reads 
     FROM performance_schema.global_status 
     WHERE VARIABLE_NAME = 'Innodb_buffer_pool_reads') t1,
    (SELECT VARIABLE_VALUE as Innodb_buffer_pool_read_requests 
     FROM performance_schema.global_status 
     WHERE VARIABLE_NAME = 'Innodb_buffer_pool_read_requests') t2;

-- ç†æƒ³å‘½ä¸­ç‡ï¼š> 95%
-- å¦‚æœå‘½ä¸­ç‡ä½ï¼Œè€ƒè™‘å¢åŠ innodb_buffer_pool_size

-- ç¼“å†²æ± ä½¿ç”¨ç‡
SELECT 
    pool_size,
    pages_data,
    pages_dirty,
    pages_free,
    (pages_data / pool_size) * 100 as usage_percent,
    (pages_dirty / pool_size) * 100 as dirty_percent
FROM 
    (SELECT SUM(POOL_SIZE) as pool_size FROM information_schema.INNODB_BUFFER_POOL_STATS) t1,
    (SELECT SUM(PAGES_DATA) as pages_data FROM information_schema.INNODB_BUFFER_POOL_STATS) t2,
    (SELECT SUM(PAGES_DIRTY) as pages_dirty FROM information_schema.INNODB_BUFFER_POOL_STATS) t3,
    (SELECT SUM(PAGES_FREE) as pages_free FROM information_schema.INNODB_BUFFER_POOL_STATS) t4;
```

### 5.4 ç¼“å†²æ± è°ƒä¼˜ç­–ç•¥


**ğŸ¯ ç¼“å†²æ± ä¼˜åŒ–æŒ‡å¯¼**
```sql
-- 1. æ ¹æ®å‘½ä¸­ç‡è°ƒæ•´å¤§å°
-- å‘½ä¸­ç‡ < 95%ï¼šå¢åŠ ç¼“å†²æ± å¤§å°
SET GLOBAL innodb_buffer_pool_size = 8589934592;  -- 8GB

-- 2. æ ¹æ®ç³»ç»Ÿè´Ÿè½½è°ƒæ•´åˆ·æ–°ç­–ç•¥
-- å†™å…¥å¯†é›†å‹ç³»ç»Ÿ
SET GLOBAL innodb_max_dirty_pages_pct = 50;       -- é™ä½è„é¡µæ¯”ä¾‹
SET GLOBAL innodb_io_capacity = 1000;             -- æé«˜IOå®¹é‡

-- è¯»å–å¯†é›†å‹ç³»ç»Ÿ  
SET GLOBAL innodb_max_dirty_pages_pct = 90;       -- å…è®¸æ›´å¤šè„é¡µ
SET GLOBAL innodb_io_capacity = 200;              -- æ ‡å‡†IOå®¹é‡

-- 3. å¤šå®ä¾‹é…ç½®ï¼ˆå¤§å†…å­˜æœåŠ¡å™¨ï¼‰
-- ç¼“å†²æ±  > 1GBæ—¶ï¼Œå»ºè®®ä½¿ç”¨å¤šå®ä¾‹
SET GLOBAL innodb_buffer_pool_instances = 8;       -- 8ä¸ªå®ä¾‹
```

---

## 6. ğŸ“œ æ—¥å¿—ç³»ç»Ÿç»„ä»¶


### 6.1 æ—¥å¿—ç³»ç»Ÿæ¶æ„


**ğŸ“‹ InnoDBæ—¥å¿—ç³»ç»Ÿç»„æˆ**
```
InnoDBæ—¥å¿—ç³»ç»Ÿï¼š

é‡åšæ—¥å¿—ç³»ç»Ÿï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é‡åšæ—¥å¿—ç¼“å†²    â”‚ â† å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²åŒº
â”‚  (Log Buffer)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ åˆ·æ–°
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é‡åšæ—¥å¿—æ–‡ä»¶    â”‚ â† ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶
â”‚  (ib_logfile)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ’¤é”€æ—¥å¿—ç³»ç»Ÿï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ’¤é”€è¡¨ç©ºé—´      â”‚ â† å­˜å‚¨äº‹åŠ¡å›æ»šä¿¡æ¯
â”‚  (Undo          â”‚
â”‚   Tablespace)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 é‡åšæ—¥å¿—è¯¦è§£


**ğŸ“ é‡åšæ—¥å¿— (Redo Log)**
```
é‡åšæ—¥å¿—ä½œç”¨ï¼š
ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼ˆDurabilityï¼‰

å·¥ä½œåŸç†ï¼š
1. äº‹åŠ¡ä¿®æ”¹æ•°æ®æ—¶ï¼Œå…ˆè®°å½•é‡åšæ—¥å¿—
2. äº‹åŠ¡æäº¤æ—¶ï¼Œå¼ºåˆ¶æ—¥å¿—åˆ·ç›˜
3. ç³»ç»Ÿå´©æºƒæ—¶ï¼Œç”¨æ—¥å¿—æ¢å¤å·²æäº¤äº‹åŠ¡
4. æ£€æŸ¥ç‚¹åï¼Œå¯¹åº”çš„æ—¥å¿—å¯ä»¥å¤ç”¨

å°±åƒï¼šé“¶è¡Œè½¬è´¦è®°å½•
- æ¯ç¬”è½¬è´¦éƒ½è¦è¯¦ç»†è®°å½•
- å‡ºé—®é¢˜æ—¶å¯ä»¥æ ¹æ®è®°å½•æ¢å¤
- ä¿è¯èµ„é‡‘å®‰å…¨
```

**ğŸ”§ é‡åšæ—¥å¿—é…ç½®**
```sql
-- é‡åšæ—¥å¿—æ ¸å¿ƒå‚æ•°
SELECT $$innodb_log_file_size;           -- å•ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°ï¼š50MB
SELECT $$innodb_log_files_in_group;      -- æ—¥å¿—æ–‡ä»¶æ•°é‡ï¼š2
SELECT $$innodb_log_buffer_size;         -- æ—¥å¿—ç¼“å†²å¤§å°ï¼š16MB

-- æ—¥å¿—åˆ·æ–°ç­–ç•¥ï¼ˆæœ€é‡è¦ï¼‰
SELECT $$innodb_flush_log_at_trx_commit; 
-- 0ï¼šæ¯ç§’åˆ·æ–°ï¼Œæ€§èƒ½æœ€å¥½ï¼Œå®‰å…¨æ€§æœ€å·®
-- 1ï¼šæ¯æ¬¡æäº¤åˆ·æ–°ï¼Œå®‰å…¨æ€§æœ€å¥½ï¼Œæ€§èƒ½ä¸€èˆ¬ï¼ˆé»˜è®¤ï¼‰
-- 2ï¼šæ¯æ¬¡æäº¤å†™OSç¼“å†²ï¼Œæ¯ç§’åˆ·ç›˜ï¼ŒæŠ˜ä¸­æ–¹æ¡ˆ

-- ç›‘æ§æ—¥å¿—ä½¿ç”¨æƒ…å†µ
SHOW STATUS LIKE 'Innodb_os_log_written';     -- å·²å†™æ—¥å¿—é‡
SHOW STATUS LIKE 'Innodb_log_waits';          -- æ—¥å¿—ç­‰å¾…æ¬¡æ•°
```

### 6.3 æ’¤é”€æ—¥å¿—ç³»ç»Ÿ


**ğŸ”„ æ’¤é”€æ—¥å¿— (Undo Log)**
```
æ’¤é”€æ—¥å¿—ä½œç”¨ï¼š
1. äº‹åŠ¡å›æ»šï¼šæ’¤é”€æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹
2. MVCCæ”¯æŒï¼šæä¾›å†å²ç‰ˆæœ¬æ•°æ®
3. ä¸€è‡´æ€§è¯»ï¼šæ”¯æŒå¿«ç…§è¯»å–

æ’¤é”€æ—¥å¿—ç”Ÿå‘½å‘¨æœŸï¼š
äº‹åŠ¡å¼€å§‹ â†’ è®°å½•åŸå§‹æ•°æ® â†’ äº‹åŠ¡æäº¤/å›æ»š â†’ ç­‰å¾…Purge â†’ ç©ºé—´å›æ”¶

å­˜å‚¨ä½ç½®ï¼š
- MySQL 5.7ä¹‹å‰ï¼šå­˜å‚¨åœ¨ç³»ç»Ÿè¡¨ç©ºé—´ibdata1ä¸­
- MySQL 5.7ä¹‹åï¼šç‹¬ç«‹çš„æ’¤é”€è¡¨ç©ºé—´æ–‡ä»¶
```

**âš™ï¸ æ’¤é”€æ—¥å¿—é…ç½®**
```sql
-- æ’¤é”€æ—¥å¿—ç›¸å…³å‚æ•°  
SELECT $$innodb_undo_tablespaces;        -- æ’¤é”€è¡¨ç©ºé—´æ•°é‡ï¼š2
SELECT $$innodb_undo_logs;               -- æ’¤é”€æ®µæ•°é‡ï¼š128  
SELECT $$innodb_max_undo_log_size;       -- å•ä¸ªæ’¤é”€æ–‡ä»¶æœ€å¤§å¤§å°ï¼š1GB

-- ç›‘æ§æ’¤é”€æ—¥å¿—ä½¿ç”¨
SELECT 
    tablespace_name,
    file_name,
    file_size / 1024 / 1024 as size_mb
FROM information_schema.files 
WHERE file_type = 'UNDO LOG';
```

---

## 7. ğŸ”’ é”ç®¡ç†å™¨


### 7.1 é”ç®¡ç†å™¨æ¶æ„


**ğŸ”¸ InnoDBé”ç³»ç»Ÿ**
é”ç®¡ç†å™¨è´Ÿè´£åè°ƒå¤šä¸ªäº‹åŠ¡å¯¹æ•°æ®çš„å¹¶å‘è®¿é—®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

```
InnoDBé”ä½“ç³»ï¼š

è¡Œçº§é”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®°å½•é”(Record) â”‚ â† é”å®šå…·ä½“è¡Œè®°å½•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é—´éš™é”(Gap)    â”‚ â† é”å®šè®°å½•é—´éš™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚  ä¸´é”®é”(Next-Key)â”‚ â† Record + Gapç»„åˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¡¨çº§é”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ„å‘é”(Intent) â”‚ â† è¡¨çº§æ„å‘é”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è‡ªå¢é”(AUTO-INC)â”‚ â† è‡ªå¢IDé”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é”ç®¡ç†å™¨å·¥ä½œæœºåˆ¶


**âš™ï¸ é”çš„è·å–å’Œé‡Šæ”¾æµç¨‹**
```
é”æ“ä½œæµç¨‹ï¼š

äº‹åŠ¡è¯·æ±‚é” â†’ é”ç®¡ç†å™¨æ£€æŸ¥å…¼å®¹æ€§ â†’ æˆäºˆé”æˆ–ç­‰å¾…

é”å…¼å®¹æ€§çŸ©é˜µï¼š
        Sé”    Xé”
Sé”     âœ…     âŒ
Xé”     âŒ     âŒ

æ­»é”æ£€æµ‹æœºåˆ¶ï¼š
1. ç»´æŠ¤ç­‰å¾…å›¾(Wait-for Graph)
2. æ£€æµ‹å¾ªç¯ä¾èµ–
3. é€‰æ‹©ä»£ä»·æœ€å°çš„äº‹åŠ¡å›æ»š
4. é‡Šæ”¾é”èµ„æºï¼Œè§£é™¤æ­»é”
```

**ğŸ” é”ç›‘æ§å’Œè¯Šæ–­**
```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ
SELECT 
    r.trx_id as requesting_trx_id,
    r.trx_mysql_thread_id as requesting_thread,
    b.trx_id as blocking_trx_id,
    b.trx_mysql_thread_id as blocking_thread,
    l.lock_table,
    l.lock_index,
    l.lock_mode
FROM information_schema.innodb_lock_waits w
JOIN information_schema.innodb_trx r ON w.requesting_trx_id = r.trx_id
JOIN information_schema.innodb_trx b ON w.blocking_trx_id = b.trx_id  
JOIN information_schema.innodb_locks l ON w.requested_lock_id = l.lock_id;

-- æŸ¥çœ‹æ­»é”ä¿¡æ¯
SHOW ENGINE INNODB STATUS\G
-- æŸ¥çœ‹LATEST DETECTED DEADLOCKéƒ¨åˆ†
```

### 7.3 é”ä¼˜åŒ–é…ç½®


**ğŸ¯ é”æ€§èƒ½è°ƒä¼˜**
```sql
-- é”ç­‰å¾…è¶…æ—¶è®¾ç½®
SELECT $$innodb_lock_wait_timeout;       -- é”ç­‰å¾…è¶…æ—¶ï¼š50ç§’
SET SESSION innodb_lock_wait_timeout = 30;

-- æ­»é”æ£€æµ‹å¼€å…³  
SELECT $$innodb_deadlock_detect;         -- æ­»é”æ£€æµ‹ï¼šON
-- é«˜å¹¶å‘æ—¶å¯è€ƒè™‘å…³é—­ï¼Œä½†è¦ç¡®ä¿åº”ç”¨æœ‰é‡è¯•æœºåˆ¶

-- è‡ªå¢é”æ¨¡å¼
SELECT $$innodb_autoinc_lock_mode;       
-- 0ï¼šä¼ ç»Ÿæ¨¡å¼ï¼ˆè¡¨çº§é”ï¼‰
-- 1ï¼šè¿ç»­æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œå…¼é¡¾æ€§èƒ½å’Œå®‰å…¨ï¼‰
-- 2ï¼šäº¤é”™æ¨¡å¼ï¼ˆæ€§èƒ½æœ€å¥½ï¼Œå¤åˆ¶æ—¶æ³¨æ„ï¼‰
```

---

## 8. ğŸ”„ äº‹åŠ¡ç®¡ç†å™¨


### 8.1 äº‹åŠ¡ç®¡ç†å™¨æ ¸å¿ƒåŠŸèƒ½


**ğŸ’¡ äº‹åŠ¡ç®¡ç†å™¨èŒè´£**
äº‹åŠ¡ç®¡ç†å™¨æ˜¯InnoDBçš„"äº¤é€šæŒ‡æŒ¥å®˜"ï¼Œè´Ÿè´£åè°ƒæ‰€æœ‰äº‹åŠ¡æ“ä½œã€‚

```
äº‹åŠ¡ç®¡ç†å™¨ä¸»è¦å·¥ä½œï¼š
1. äº‹åŠ¡çŠ¶æ€ç®¡ç†ï¼šè·Ÿè¸ªäº‹åŠ¡ç”Ÿå‘½å‘¨æœŸ
2. MVCCæ§åˆ¶ï¼šç®¡ç†å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶
3. éš”ç¦»çº§åˆ«å®ç°ï¼šä¿è¯äº‹åŠ¡éš”ç¦»æ€§
4. æäº¤/å›æ»šåè°ƒï¼šåè°ƒç›¸å…³ç»„ä»¶å®Œæˆäº‹åŠ¡

äº‹åŠ¡çŠ¶æ€è½¬æ¢ï¼š
æ´»è·ƒ â†’ éƒ¨åˆ†æäº¤ â†’ æäº¤
  â†“      â†“        â†‘
 å¤±è´¥ â†’ ä¸­æ­¢ â”€â”€â”€â”€â”€â”˜
```

### 8.2 MVCCæœºåˆ¶å®ç°


**ğŸ”¸ å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶**
```sql
-- MVCCç›¸å…³å‚æ•°
SELECT $$transaction_isolation;          -- äº‹åŠ¡éš”ç¦»çº§åˆ«
SELECT $$innodb_undo_retention;         -- æ’¤é”€æ—¥å¿—ä¿ç•™æ—¶é—´

-- æŸ¥çœ‹å½“å‰æ´»è·ƒäº‹åŠ¡
SELECT 
    trx_id,
    trx_state,
    trx_started,
    trx_isolation_level,
    trx_autocommit
FROM information_schema.innodb_trx;

MVCCå·¥ä½œåŸç†ï¼š
- æ¯è¡Œè®°å½•åŒ…å«éšè—åˆ—ï¼šDB_TRX_IDã€DB_ROLL_PTR
- è¯»å–æ—¶æ ¹æ®äº‹åŠ¡IDåˆ¤æ–­ç‰ˆæœ¬å¯è§æ€§
- é€šè¿‡æ’¤é”€æ—¥å¿—æ„é€ å†å²ç‰ˆæœ¬
```

### 8.3 äº‹åŠ¡éš”ç¦»çº§åˆ«ç®¡ç†


**ğŸ¯ éš”ç¦»çº§åˆ«å¯¹æ¯”**

| éš”ç¦»çº§åˆ« | **è„è¯»** | **ä¸å¯é‡å¤è¯»** | **å¹»è¯»** | **æ€§èƒ½** | **é”å¼€é”€** |
|----------|---------|---------------|---------|---------|-----------|
| **READ UNCOMMITTED** | âŒ å¯èƒ½ | âŒ å¯èƒ½ | âŒ å¯èƒ½ | â­â­â­â­â­ | æœ€å° |
| **READ COMMITTED** | âœ… é˜²æ­¢ | âŒ å¯èƒ½ | âŒ å¯èƒ½ | â­â­â­â­ | è¾ƒå° |
| **REPEATABLE READ** | âœ… é˜²æ­¢ | âœ… é˜²æ­¢ | âš ï¸ éƒ¨åˆ†é˜²æ­¢ | â­â­â­ | ä¸­ç­‰ |
| **SERIALIZABLE** | âœ… é˜²æ­¢ | âœ… é˜²æ­¢ | âœ… é˜²æ­¢ | â­â­ | æœ€å¤§ |

```sql
-- è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«
SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- InnoDBé»˜è®¤ï¼šREPEATABLE READ
-- äº’è”ç½‘åº”ç”¨å¸¸ç”¨ï¼šREAD COMMITTED
```

---

## 9. ğŸ”Œ å­˜å‚¨å¼•æ“æ¥å£


### 9.1 å­˜å‚¨å¼•æ“æ¥å£è®¾è®¡


**ğŸ”¸ æ¥å£å±‚ä½œç”¨**
å­˜å‚¨å¼•æ“æ¥å£æ˜¯MySQL Serverå±‚ä¸InnoDBä¹‹é—´çš„"ç¿»è¯‘å®˜"ï¼Œè´Ÿè´£åè®®è½¬æ¢å’Œè¯·æ±‚åˆ†å‘ã€‚

```
æ¥å£å±‚å·¥ä½œæµç¨‹ï¼š

SQLè¯·æ±‚ â†’ MySQLè§£æå™¨ â†’ æŸ¥è¯¢ä¼˜åŒ–å™¨ â†’ å­˜å‚¨å¼•æ“æ¥å£ â†’ InnoDBå¼•æ“

ä¸»è¦æ¥å£å‡½æ•°ï¼š
- ha_innodb::open()ï¼šæ‰“å¼€è¡¨
- ha_innodb::rnd_next()ï¼šé¡ºåºè¯»å–è®°å½•
- ha_innodb::index_read()ï¼šç´¢å¼•è¯»å–
- ha_innodb::write_row()ï¼šæ’å…¥è®°å½•
- ha_innodb::update_row()ï¼šæ›´æ–°è®°å½•
- ha_innodb::delete_row()ï¼šåˆ é™¤è®°å½•
```

### 9.2 æ¥å£æ€§èƒ½ä¼˜åŒ–


**âš¡ æ¥å£å±‚ä¼˜åŒ–**
```sql
-- æŸ¥çœ‹å­˜å‚¨å¼•æ“ç»Ÿè®¡ä¿¡æ¯
SHOW STATUS LIKE 'Handler%';

-- å…³é”®æŒ‡æ ‡ï¼š
-- Handler_read_firstï¼šç´¢å¼•ç¬¬ä¸€ä¸ªæ¡ç›®è¯»å–æ¬¡æ•°
-- Handler_read_keyï¼šé€šè¿‡ç´¢å¼•è¯»å–è¡Œçš„æ¬¡æ•°
-- Handler_read_nextï¼šæŒ‰ç´¢å¼•é¡ºåºè¯»å–ä¸‹ä¸€è¡Œçš„æ¬¡æ•°  
-- Handler_read_rndï¼šæ ¹æ®ä½ç½®è¯»å–è¡Œçš„æ¬¡æ•°
-- Handler_read_rnd_nextï¼šæ•°æ®æ–‡ä»¶ä¸­ä¸‹ä¸€è¡Œçš„è¯»å–æ¬¡æ•°

-- æ€§èƒ½åˆ†æï¼š
-- Handler_read_rnd_nextè¿‡é«˜ï¼šå¯èƒ½å­˜åœ¨å…¨è¡¨æ‰«æ
-- Handler_read_key / Handler_read_rnd_next æ¯”å€¼ä½ï¼šç´¢å¼•ä½¿ç”¨ç‡ä½
```

### 9.3 å­˜å‚¨å¼•æ“åˆ‡æ¢


**ğŸ”„ å¼•æ“åˆ‡æ¢ç¤ºä¾‹**
```sql
-- æŸ¥çœ‹è¡¨å½“å‰ä½¿ç”¨çš„å­˜å‚¨å¼•æ“
SELECT 
    table_schema,
    table_name,
    engine
FROM information_schema.tables 
WHERE table_schema = 'your_database';

-- åˆ‡æ¢å­˜å‚¨å¼•æ“ï¼ˆè°¨æ…æ“ä½œï¼‰
ALTER TABLE your_table ENGINE = InnoDB;

-- æŸ¥çœ‹æ”¯æŒçš„å­˜å‚¨å¼•æ“
SHOW ENGINES;
```

---

## 10. ğŸ¤ ç»„ä»¶åä½œæœºåˆ¶


### 10.1 æ•°æ®è¯»å–åä½œæµç¨‹


**ğŸ“– è¯»å–æ“ä½œçš„ç»„ä»¶åä½œ**
```
æ•°æ®è¯»å–å®Œæ•´æµç¨‹ï¼š

å®¢æˆ·ç«¯è¯·æ±‚
    â†“
å­˜å‚¨å¼•æ“æ¥å£æ¥æ”¶è¯·æ±‚
    â†“
ç¼“å†²æ± æ£€æŸ¥æ•°æ®æ˜¯å¦åœ¨å†…å­˜ä¸­
    â†“ (å‘½ä¸­)          â†“ (æœªå‘½ä¸­)
ç›´æ¥è¿”å›æ•°æ®        IO Threadè¯»å–ç£ç›˜
    â†“                â†“
äº‹åŠ¡ç®¡ç†å™¨æ£€æŸ¥      åŠ è½½åˆ°ç¼“å†²æ± 
ç‰ˆæœ¬å¯è§æ€§          â†“
    â†“              è¿”å›æ•°æ®ç»™ç”¨æˆ·
è¿”å›æœ€ç»ˆç»“æœ
```

### 10.2 æ•°æ®å†™å…¥åä½œæµç¨‹


**ğŸ“ å†™å…¥æ“ä½œçš„ç»„ä»¶åä½œ**
```
æ•°æ®å†™å…¥å®Œæ•´æµç¨‹ï¼š

äº‹åŠ¡å¼€å§‹å†™å…¥
    â†“
äº‹åŠ¡ç®¡ç†å™¨åˆ†é…äº‹åŠ¡ID
    â†“
é”ç®¡ç†å™¨è·å–å¿…è¦é”
    â†“
åœ¨ç¼“å†²æ± ä¸­ä¿®æ”¹æ•°æ®é¡µï¼ˆäº§ç”Ÿè„é¡µï¼‰
    â†“
é‡åšæ—¥å¿—ç¼“å†²è®°å½•ä¿®æ”¹æ“ä½œ
    â†“
äº‹åŠ¡æäº¤æ—¶é‡åšæ—¥å¿—åˆ·ç›˜
    â†“
Page Cleanerå¼‚æ­¥å°†è„é¡µåˆ·ç›˜
    â†“
Purge Threadæ¸…ç†æ—§ç‰ˆæœ¬æ•°æ®
```

### 10.3 æ•…éšœæ¢å¤åä½œæœºåˆ¶


**ğŸ› ï¸ å´©æºƒæ¢å¤æµç¨‹**
```sql
-- InnoDBå´©æºƒæ¢å¤è¿‡ç¨‹
-- 1. è¯»å–é‡åšæ—¥å¿—ï¼Œæ‰¾åˆ°æœ€åçš„æ£€æŸ¥ç‚¹
-- 2. ä»æ£€æŸ¥ç‚¹å¼€å§‹é‡æ”¾æ—¥å¿—
-- 3. æ¢å¤æ‰€æœ‰å·²æäº¤äº‹åŠ¡çš„ä¿®æ”¹
-- 4. å›æ»šæ‰€æœ‰æœªæäº¤äº‹åŠ¡

-- æŸ¥çœ‹æ¢å¤çŠ¶æ€
SHOW STATUS LIKE 'Innodb_recovery%';

-- æ¢å¤ç›¸å…³å‚æ•°
SELECT $$innodb_force_recovery;          -- å¼ºåˆ¶æ¢å¤çº§åˆ«ï¼š0ï¼ˆæ­£å¸¸ï¼‰
-- 0ï¼šæ­£å¸¸å¯åŠ¨
-- 1-6ï¼šä¸åŒçº§åˆ«çš„å¼ºåˆ¶æ¢å¤ï¼ˆæ•°æ®å¯èƒ½ä¸¢å¤±ï¼‰
```

### 10.4 ç»„ä»¶æ€§èƒ½ç“¶é¢ˆåˆ†æ


**ğŸ” ç“¶é¢ˆè¯†åˆ«æ–¹æ³•**
```sql
-- ç¼“å†²æ± ç“¶é¢ˆæ£€æŸ¥
SELECT 
    (Innodb_buffer_pool_reads / Innodb_buffer_pool_read_requests) * 100 as miss_rate
FROM performance_schema.global_status;
-- miss_rate > 5% è¯´æ˜ç¼“å†²æ± ä¸è¶³

-- IOç“¶é¢ˆæ£€æŸ¥
SHOW STATUS LIKE 'Innodb_data_pending%';
-- Innodb_data_pending_reads > 0ï¼šè¯»IOç“¶é¢ˆ
-- Innodb_data_pending_writes > 0ï¼šå†™IOç“¶é¢ˆ

-- é”ç“¶é¢ˆæ£€æŸ¥
SELECT COUNT(*) FROM information_schema.innodb_lock_waits;
-- é”ç­‰å¾…æ•°é‡è¿‡å¤šè¯´æ˜å¹¶å‘å†²çªä¸¥é‡

-- æ—¥å¿—ç“¶é¢ˆæ£€æŸ¥  
SHOW STATUS LIKE 'Innodb_log_waits';
-- Innodb_log_waits > 0ï¼šæ—¥å¿—ç¼“å†²åŒºä¸è¶³
```

### 10.5 ç»„ä»¶æ•…éšœå½±å“åˆ†æ


**âš ï¸ ç»„ä»¶æ•…éšœå½±å“è¯„ä¼°**
```
å„ç»„ä»¶æ•…éšœå½±å“ï¼š

ç¼“å†²æ± æ•…éšœï¼š
- ç°è±¡ï¼šå†…å­˜ä¸è¶³ï¼Œå¤§é‡ç£ç›˜IO
- å½±å“ï¼šæŸ¥è¯¢æ€§èƒ½æ€¥å‰§ä¸‹é™
- å¤„ç†ï¼šå¢åŠ innodb_buffer_pool_size

IO Threadæ•…éšœï¼š  
- ç°è±¡ï¼šIOæ“ä½œå †ç§¯ï¼Œå“åº”ç¼“æ…¢
- å½±å“ï¼šè¯»å†™æ“ä½œå»¶è¿Ÿå¢åŠ 
- å¤„ç†ï¼šæ£€æŸ¥ç£ç›˜æ€§èƒ½ï¼Œè°ƒæ•´IOçº¿ç¨‹æ•°

Page Cleaneræ•…éšœï¼š
- ç°è±¡ï¼šè„é¡µå †ç§¯ï¼Œå†…å­˜è€—å°½
- å½±å“ï¼šæ–°äº‹åŠ¡æ— æ³•æ‰§è¡Œ
- å¤„ç†ï¼šæ£€æŸ¥ç£ç›˜ç©ºé—´ï¼Œè°ƒæ•´åˆ·æ–°ç­–ç•¥

Master Threadæ•…éšœï¼š
- ç°è±¡ï¼šåå°ä»»åŠ¡åœæ­¢ï¼Œç³»ç»Ÿå¼‚å¸¸
- å½±å“ï¼šå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- å¤„ç†ï¼šé‡å¯MySQLæœåŠ¡

æ—¥å¿—ç³»ç»Ÿæ•…éšœï¼š
- ç°è±¡ï¼šäº‹åŠ¡æ— æ³•æäº¤
- å½±å“ï¼šæ•°æ®åº“å®Œå…¨ä¸å¯ç”¨
- å¤„ç†ï¼šæ£€æŸ¥ç£ç›˜ç©ºé—´å’Œæƒé™
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ InnoDBæ¶æ„ä½“ç³»**
```
âœ“ ä¸‰å¤§ç»„æˆéƒ¨åˆ†ï¼šå†…å­˜ç»“æ„ + åå°çº¿ç¨‹ + ç£ç›˜æ–‡ä»¶
âœ“ æ ¸å¿ƒå†…å­˜ç»„ä»¶ï¼šç¼“å†²æ± ã€æ—¥å¿—ç¼“å†²ã€é¢å¤–å†…å­˜æ± 
âœ“ å…³é”®åå°çº¿ç¨‹ï¼šMaster Threadã€IO Threadã€Page Cleanerã€Purge Thread
âœ“ é‡è¦ç£ç›˜æ–‡ä»¶ï¼šè¡¨ç©ºé—´æ–‡ä»¶ã€é‡åšæ—¥å¿—æ–‡ä»¶ã€æ’¤é”€æ—¥å¿—æ–‡ä»¶
âœ“ ç®¡ç†å™¨ç³»ç»Ÿï¼šé”ç®¡ç†å™¨ã€äº‹åŠ¡ç®¡ç†å™¨ã€å­˜å‚¨å¼•æ“æ¥å£
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç»„ä»¶åä½œåŸç†**
```
æ•°æ®æµåä½œï¼š
ç”¨æˆ·è¯·æ±‚ â†’ æ¥å£å±‚ â†’ äº‹åŠ¡ç®¡ç† â†’ é”æ§åˆ¶ â†’ ç¼“å†²æ± æ“ä½œ â†’ åå°çº¿ç¨‹ â†’ ç£ç›˜æ–‡ä»¶

æ§åˆ¶æµåä½œï¼š
Master Threadåè°ƒæ•´ä½“ â†’ IO Threadå¤„ç†ç£ç›˜æ“ä½œ â†’ Page Cleanerç»´æŠ¤ç¼“å­˜ä¸€è‡´æ€§ â†’ Purge Threadæ¸…ç†åƒåœ¾

æ•…éšœå¤„ç†åä½œï¼š
ç›‘æ§ç»„ä»¶å‘ç°å¼‚å¸¸ â†’ äº‹åŠ¡ç®¡ç†å™¨åè°ƒå›æ»š â†’ æ—¥å¿—ç³»ç»Ÿæ¢å¤æ•°æ® â†’ é”ç®¡ç†å™¨é‡Šæ”¾èµ„æº
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹**
```
å†…å­˜ä¼˜åŒ–ï¼š
- ç¼“å†²æ± å¤§å°ï¼šæœåŠ¡å™¨å†…å­˜çš„60-80%
- ç¼“å†²æ± å®ä¾‹ï¼šå¤§å†…å­˜æœåŠ¡å™¨ä½¿ç”¨å¤šå®ä¾‹
- æ—¥å¿—ç¼“å†²ï¼šæ ¹æ®äº‹åŠ¡é¢‘ç‡è°ƒæ•´

çº¿ç¨‹ä¼˜åŒ–ï¼š
- IOçº¿ç¨‹æ•°ï¼šæ ¹æ®ç£ç›˜æ•°é‡è°ƒæ•´
- Purgeçº¿ç¨‹ï¼šé«˜å¹¶å‘æ—¶å¢åŠ çº¿ç¨‹æ•°
- Page Cleanerï¼šSSDå­˜å‚¨å¯å¢åŠ çº¿ç¨‹æ•°

å‚æ•°è°ƒä¼˜ï¼š
- æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹ï¼ˆOLTP/OLAPï¼‰é€‰æ‹©ä¸åŒç­–ç•¥
- å®šæœŸç›‘æ§æ€§èƒ½æŒ‡æ ‡ï¼ŒåŠ¨æ€è°ƒæ•´å‚æ•°
- åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ä¼˜åŒ–æ•ˆæœ
```

### 11.3 ç›‘æ§å’Œç»´æŠ¤è¦ç‚¹


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```sql
-- ç¼“å†²æ± æ•ˆç‡
SELECT (1 - buffer_pool_reads/buffer_pool_read_requests) * 100 as hit_ratio;

-- è„é¡µæ¯”ä¾‹  
SELECT pages_dirty/pages_total * 100 as dirty_page_percent;

-- é”ç­‰å¾…ç»Ÿè®¡
SELECT COUNT(*) as lock_waits FROM information_schema.innodb_lock_waits;

-- æ—¥å¿—ä½¿ç”¨æƒ…å†µ
SHOW STATUS LIKE 'Innodb_log%';
```

**ğŸ¯ ç»´æŠ¤æœ€ä½³å®è·µ**
```
æ—¥å¸¸ç›‘æ§ï¼š
âœ“ å®šæœŸæ£€æŸ¥ç¼“å†²æ± å‘½ä¸­ç‡ï¼ˆ>95%ï¼‰
âœ“ ç›‘æ§è„é¡µæ¯”ä¾‹ï¼ˆ<75%ï¼‰
âœ“ å…³æ³¨é”ç­‰å¾…å’Œæ­»é”æƒ…å†µ
âœ“ æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°å’Œå¢é•¿é€Ÿåº¦

å®šæœŸç»´æŠ¤ï¼š
âœ“ åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä¼˜åŒ–SQL
âœ“ ç›‘æ§è¡¨ç¢ç‰‡ï¼ŒåŠæ—¶æ•´ç†
âœ“ æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®æ€§
âœ“ è¯„ä¼°å‚æ•°é…ç½®åˆç†æ€§

æ•…éšœå¤„ç†ï¼š
âœ“ å»ºç«‹ç›‘æ§å‘Šè­¦æœºåˆ¶
âœ“ å‡†å¤‡æ•…éšœæ¢å¤é¢„æ¡ˆ
âœ“ å®šæœŸå¤‡ä»½å’Œæ¢å¤æ¼”ç»ƒ
âœ“ ä¿æŒç³»ç»Ÿå’Œåº”ç”¨æ—¥å¿—
```

### 11.4 æ¶æ„æ¼”è¿›è¶‹åŠ¿


**ğŸš€ InnoDBå‘å±•æ–¹å‘**
```
æŠ€æœ¯å‘å±•è¶‹åŠ¿ï¼š
- å†…å­˜ç®¡ç†ï¼šæ›´æ™ºèƒ½çš„ç¼“å­˜ç®—æ³•ï¼Œæ”¯æŒæŒä¹…åŒ–å†…å­˜
- å¹¶å‘æ§åˆ¶ï¼šæ›´ç»†ç²’åº¦çš„é”æœºåˆ¶ï¼Œå‡å°‘é”å†²çª
- å­˜å‚¨ä¼˜åŒ–ï¼šæ›´å¥½çš„å‹ç¼©ç®—æ³•ï¼ŒSSDä¼˜åŒ–
- ç›‘æ§å¢å¼ºï¼šæ›´ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¯è§†åŒ–ç›‘æ§

ç‰ˆæœ¬ç‰¹æ€§ï¼š
MySQL 8.0æ–°ç‰¹æ€§ï¼š
- åŸå­DDLæ“ä½œ
- ä¸å¯è§ç´¢å¼•
- å‡½æ•°ç´¢å¼•
- æ›´å¿«çš„æ•°æ®å­—å…¸
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- InnoDBæ¶æ„é‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼Œå†…å­˜+çº¿ç¨‹+ç£ç›˜ä¸‰å±‚åä½œ
- ç¼“å†²æ± æ˜¯æ€§èƒ½å…³é”®ï¼ŒMaster Threadæ˜¯åè°ƒæ ¸å¿ƒ
- å„ç»„ä»¶èŒè´£æ˜ç¡®ä½†ç´§å¯†åä½œï¼Œä»»ä¸€ç»„ä»¶éƒ½ä¸å¯ç¼ºå°‘
- ç›‘æ§å’Œè°ƒä¼˜è¦ç³»ç»ŸåŒ–ï¼Œä¸èƒ½åªå…³æ³¨å•ä¸ªç»„ä»¶
- ç†è§£ç»„ä»¶åä½œæœºåˆ¶æ˜¯æ·±åº¦ä¼˜åŒ–InnoDBçš„åŸºç¡€