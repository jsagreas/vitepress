---
title: 9ã€InnoDBå†…å­˜ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [InnoDBå†…å­˜æ¶æ„æ¦‚è¿°](#1-InnoDBå†…å­˜æ¶æ„æ¦‚è¿°)
2. [å†…å­˜æ± è®¾è®¡åŸç†](#2-å†…å­˜æ± è®¾è®¡åŸç†)
3. [ç¼“å†²æ± ç®¡ç†æœºåˆ¶](#3-ç¼“å†²æ± ç®¡ç†æœºåˆ¶)
4. [å†…å­˜åˆ†é…ç­–ç•¥è¯¦è§£](#4-å†…å­˜åˆ†é…ç­–ç•¥è¯¦è§£)
5. [å†…å­˜ç®¡ç†ç®—æ³•å®ç°](#5-å†…å­˜ç®¡ç†ç®—æ³•å®ç°)
6. [å†…å­˜ç¢ç‰‡æ£€æµ‹ä¸æ•´ç†](#6-å†…å­˜ç¢ç‰‡æ£€æµ‹ä¸æ•´ç†)
7. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#7-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
8. [NUMAæ¶æ„ä¼˜åŒ–](#8-NUMAæ¶æ„ä¼˜åŒ–)
9. [å†…å­˜ç›‘æ§ä¸è°ƒè¯•](#9-å†…å­˜ç›‘æ§ä¸è°ƒè¯•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ InnoDBå†…å­˜æ¶æ„æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯InnoDBå†…å­˜ç®¡ç†


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
InnoDBå†…å­˜ç®¡ç†å°±åƒæ˜¯ä¸€ä¸ª**æ™ºèƒ½çš„å†…å­˜ç®¡å®¶**ï¼Œä¸“é—¨è´Ÿè´£MySQLæ•°æ®åº“å¼•æ“çš„å†…å­˜ä½¿ç”¨ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœMySQLæ˜¯ä¸€åº§å¤§æ¥¼ï¼Œé‚£ä¹ˆInnoDBå†…å­˜ç®¡ç†å°±æ˜¯è¿™åº§å¤§æ¥¼çš„ç‰©ä¸šç®¡ç†ç³»ç»Ÿï¼Œè´Ÿè´£åˆ†é…æˆ¿é—´ã€æ¸…ç†åƒåœ¾ã€ç»´æŠ¤è®¾æ–½ã€‚

```
ç°å®ç±»æ¯”ï¼šé…’åº—å†…å­˜ç®¡ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ğŸ¨ MySQLæ•°æ®åº“é…’åº—            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ›ï¸  ç¼“å†²æ± (Buffer Pool)         â”‚ â† å®¢æˆ¿åŒºåŸŸï¼Œå­˜æ”¾å¸¸ç”¨æ•°æ®
â”‚ ğŸ½ï¸  æ—¥å¿—ç¼“å†²åŒº(Log Buffer)      â”‚ â† é¤å…ï¼Œä¸´æ—¶å­˜æ”¾æ“ä½œè®°å½•
â”‚ ğŸ”§  é¢å¤–å†…å­˜æ± (Additional Pool) â”‚ â† å·¥å…·æˆ¿ï¼Œå­˜æ”¾ç®¡ç†ä¿¡æ¯
â”‚ ğŸ«  æ•°æ®å­—å…¸ç¼“å­˜                 â”‚ â† å‰å°ï¼Œå­˜æ”¾ç™»è®°ä¿¡æ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 InnoDBå†…å­˜ç»„æˆç»“æ„


**ğŸ“Š å†…å­˜å¸ƒå±€æ€»è§ˆ**
```
InnoDBå†…å­˜æ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 InnoDB Memory                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”µ Buffer Pool (ç¼“å†²æ± ) - 85%                     â”‚
â”‚    â”œâ”€ Data Pages (æ•°æ®é¡µ)                         â”‚
â”‚    â”œâ”€ Index Pages (ç´¢å¼•é¡µ)                        â”‚
â”‚    â”œâ”€ Insert Buffer (æ’å…¥ç¼“å†²)                     â”‚
â”‚    â””â”€ Lock Info (é”ä¿¡æ¯)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ Log Buffer (æ—¥å¿—ç¼“å†²åŒº) - 8%                   â”‚
â”‚    â”œâ”€ Redo Log Buffer                             â”‚
â”‚    â””â”€ Undo Log Buffer                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ Additional Memory Pool (é¢å¤–å†…å­˜æ± ) - 5%       â”‚
â”‚    â”œâ”€ Data Dictionary Cache                       â”‚
â”‚    â”œâ”€ Thread Pool                                 â”‚
â”‚    â””â”€ OS Cache                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ Other Memory (å…¶ä»–å†…å­˜) - 2%                   â”‚
â”‚    â”œâ”€ Query Cache                                 â”‚
â”‚    â””â”€ Connection Buffers                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 å†…å­˜ç®¡ç†çš„æ ¸å¿ƒä½œç”¨


**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦ä¸“é—¨çš„å†…å­˜ç®¡ç†**

| é—®é¢˜ | æ²¡æœ‰å†…å­˜ç®¡ç† | æœ‰å†…å­˜ç®¡ç† |
|------|-------------|-----------|
| **æ•°æ®è®¿é—®** | æ¯æ¬¡éƒ½ä»ç£ç›˜è¯»å–ï¼Œæ…¢å¦‚èœ—ç‰› ğŸŒ | çƒ­ç‚¹æ•°æ®åœ¨å†…å­˜ä¸­ï¼Œå¿«å¦‚é—ªç”µ âš¡ |
| **å†…å­˜ä½¿ç”¨** | æ‚ä¹±æ— ç« ï¼Œæµªè´¹ä¸¥é‡ | äº•ç„¶æœ‰åºï¼Œé«˜æ•ˆåˆ©ç”¨ |
| **å¹¶å‘æ§åˆ¶** | å†²çªé¢‘ç¹ï¼Œæ€§èƒ½ä½ä¸‹ | åˆç†è°ƒåº¦ï¼Œå¹¶å‘å‹å¥½ |
| **æ•…éšœæ¢å¤** | æ•°æ®å®¹æ˜“ä¸¢å¤± | æ—¥å¿—ä¿æŠ¤ï¼Œå¯é æ¢å¤ |

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
> ğŸŒ° **å°±åƒå›¾ä¹¦é¦†ç®¡ç†**ï¼šæ²¡æœ‰å†…å­˜ç®¡ç†å°±åƒå›¾ä¹¦é¦†æ²¡æœ‰ç®¡ç†å‘˜ï¼Œä¹¦ç±ä¹±æ”¾ï¼Œæ‰¾æœ¬ä¹¦è¦ç¿»éæ•´ä¸ªé¦†ï¼›æœ‰äº†å†…å­˜ç®¡ç†å°±åƒæœ‰äº†ä¸“ä¸šç®¡ç†å‘˜ï¼Œçƒ­é—¨ä¹¦ç±æ”¾åœ¨æ˜¾çœ¼ä½ç½®ï¼ŒæŸ¥æ‰¾æ•ˆç‡å¤§å¤§æå‡ã€‚

---

## 2. ğŸŠâ€â™‚ï¸ å†…å­˜æ± è®¾è®¡åŸç†


### 2.1 ä»€ä¹ˆæ˜¯å†…å­˜æ± 


**ğŸ”¸ å†…å­˜æ± æ¦‚å¿µè¯¦è§£**
å†…å­˜æ± ï¼ˆMemory Poolï¼‰å°±åƒæ˜¯ä¸€ä¸ª**é¢„å…ˆå‡†å¤‡å¥½çš„å·¥å…·ç®±**ã€‚ä¼ ç»Ÿçš„å†…å­˜ç®¡ç†æ˜¯"ç”¨æ—¶å†ä¹°"ï¼Œè€Œå†…å­˜æ± æ˜¯"æå‰å›¤è´§"ã€‚

```
ä¼ ç»Ÿå†…å­˜åˆ†é… vs å†…å­˜æ± ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼š
éœ€è¦å†…å­˜ â†’ å‘OSç”³è¯· â†’ ä½¿ç”¨ â†’ é‡Šæ”¾ç»™OS â†’ é‡å¤
é—®é¢˜ï¼šé¢‘ç¹ç”³è¯·é‡Šæ”¾ï¼Œå¼€é”€å¤§ï¼Œç¢ç‰‡å¤š

å†…å­˜æ± æ–¹å¼ï¼š
å¯åŠ¨æ—¶é¢„åˆ†é…å¤§å—å†…å­˜ â†’ å†…éƒ¨ç®¡ç†åˆ†é… â†’ ä½¿ç”¨ â†’ å†…éƒ¨å›æ”¶ â†’ é‡å¤åˆ©ç”¨
ä¼˜åŠ¿ï¼šå‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼Œæé«˜æ•ˆç‡ï¼Œå‡å°‘ç¢ç‰‡
```

### 2.2 InnoDBå†…å­˜æ± æ¶æ„


**ğŸ—ï¸ å¤šå±‚å†…å­˜æ± è®¾è®¡**

```
InnoDBå†…å­˜æ± å±‚æ¬¡ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ åº”ç”¨å±‚ (SQLæ‰§è¡Œ)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”„ ç¼“å­˜å±‚ (Buffer Pool Manager)    â”‚
â”‚     â”œâ”€ LRUé“¾è¡¨ç®¡ç†                  â”‚
â”‚     â”œâ”€ è„é¡µç®¡ç†                     â”‚
â”‚     â””â”€ é¢„è¯»æœºåˆ¶                     â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ åˆ†é…å±‚ (Memory Allocator)       â”‚
â”‚     â”œâ”€ å—åˆ†é…å™¨                     â”‚
â”‚     â”œâ”€ é¡µåˆ†é…å™¨                     â”‚
â”‚     â””â”€ å¯¹è±¡æ±                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§± åº•å±‚ (OS Memory)                â”‚
â”‚     â”œâ”€ ç‰©ç†å†…å­˜                     â”‚
â”‚     â””â”€ è™šæ‹Ÿå†…å­˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å†…å­˜æ± çš„å·¥ä½œæµç¨‹


**ğŸ”„ å†…å­˜æ± æ“ä½œæµç¨‹**

**å¯åŠ¨é˜¶æ®µï¼š**
```
1. ç³»ç»Ÿå¯åŠ¨ â†’ è¯»å–é…ç½®å‚æ•°
2. å‘OSç”³è¯·å¤§å—è¿ç»­å†…å­˜
3. åˆ’åˆ†ä¸åŒç”¨é€”çš„å†…å­˜åŒºåŸŸ
4. åˆå§‹åŒ–ç®¡ç†æ•°æ®ç»“æ„
5. å»ºç«‹å†…å­˜ä½¿ç”¨ç›‘æ§æœºåˆ¶
```

**è¿è¡Œé˜¶æ®µï¼š**
```
å†…å­˜ç”³è¯·æµç¨‹ï¼š
è¯·æ±‚å†…å­˜ â†’ æ£€æŸ¥å†…å­˜æ±  â†’ æ‰¾åˆ°åˆé€‚å— â†’ åˆ†é…ä½¿ç”¨
     â†“              â†“            â†“          â†“
   åº”ç”¨éœ€è¦    â†’   æ± å†…æŸ¥æ‰¾   â†’   å—åˆ‡åˆ†   â†’  è¿”å›åœ°å€

å†…å­˜é‡Šæ”¾æµç¨‹ï¼š  
é‡Šæ”¾å†…å­˜ â†’ æ ‡è®°ä¸ºç©ºé—² â†’ å°è¯•åˆå¹¶ â†’ å›æ”¶åˆ°æ± ä¸­
     â†“              â†“          â†“          â†“
   ä½¿ç”¨å®Œæ¯•    â†’   çŠ¶æ€æ›´æ–°   â†’  ç¢ç‰‡æ•´ç†  â†’  é‡æ–°å¯ç”¨
```

---

## 3. ğŸ”„ ç¼“å†²æ± ç®¡ç†æœºåˆ¶


### 3.1 ç¼“å†²æ± æ˜¯ä»€ä¹ˆ


**ğŸ”¸ ç¼“å†²æ± åŸºæœ¬æ¦‚å¿µ**
ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰æ˜¯InnoDBæœ€é‡è¦çš„å†…å­˜åŒºåŸŸï¼Œå æ®äº†æ€»å†…å­˜çš„80-90%ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ª**è¶…å¤§çš„é«˜é€Ÿç¼“å­˜ä»“åº“**ã€‚

> ğŸŒ° **ç”Ÿæ´»ç±»æ¯”**ï¼šç¼“å†²æ± å°±åƒè¶…å¸‚çš„è´§æ¶ã€‚çƒ­é”€å•†å“æ”¾åœ¨æ˜¾çœ¼ä½ç½®ï¼ˆçƒ­ç‚¹æ•°æ®å¸¸é©»å†…å­˜ï¼‰ï¼Œå†·é—¨å•†å“æ”¾åœ¨ä»“åº“ï¼ˆå†·æ•°æ®å­˜åœ¨ç£ç›˜ï¼‰ï¼Œé¡¾å®¢éœ€è¦æ—¶ä»è´§æ¶ä¸Šç›´æ¥æ‹¿å–ï¼Œæ¯”å»ä»“åº“æ‰¾è¦å¿«å¾—å¤šã€‚

### 3.2 ç¼“å†²æ± å†…éƒ¨ç»“æ„


**ğŸ“‹ ç¼“å†²æ± ç»„æˆéƒ¨åˆ†**

```
Buffer Poolè¯¦ç»†ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Buffer Pool                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ—„ï¸  Data Pages (æ•°æ®é¡µç¼“å­˜)                â”‚
â”‚     â€¢ ç”¨æˆ·è¡¨æ•°æ®                            â”‚
â”‚     â€¢ ç³»ç»Ÿè¡¨æ•°æ®                            â”‚
â”‚     â€¢ ä¸´æ—¶è¡¨æ•°æ®                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‡ Index Pages (ç´¢å¼•é¡µç¼“å­˜)                 â”‚  
â”‚     â€¢ B+Treeç´¢å¼•èŠ‚ç‚¹                        â”‚
â”‚     â€¢ èšé›†ç´¢å¼•é¡µ                            â”‚
â”‚     â€¢ äºŒçº§ç´¢å¼•é¡µ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Insert Buffer (æ’å…¥ç¼“å†²)                 â”‚
â”‚     â€¢ éèšé›†ç´¢å¼•çš„æ’å…¥æ“ä½œ                   â”‚
â”‚     â€¢ æ‰¹é‡æ’å…¥ä¼˜åŒ–                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”’ Lock Information (é”ä¿¡æ¯)                â”‚
â”‚     â€¢ è¡Œé”ä¿¡æ¯                              â”‚
â”‚     â€¢ è¡¨é”ä¿¡æ¯                              â”‚
â”‚     â€¢ æ­»é”æ£€æµ‹æ•°æ®                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Adaptive Hash Index (è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•)     â”‚
â”‚     â€¢ çƒ­ç‚¹é¡µé¢çš„å“ˆå¸Œç´¢å¼•                     â”‚
â”‚     â€¢ å¿«é€Ÿå®šä½æœºåˆ¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 LRUç®—æ³•å®ç°


**ğŸ§  LRUç®—æ³•åŸç†**
LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•å°±åƒæ˜¯ä¸€ä¸ª**æ™ºèƒ½çš„æ¸…æ´å·¥**ï¼Œä¸“é—¨è´Ÿè´£å†³å®šå“ªäº›æ•°æ®åº”è¯¥ç•™åœ¨å†…å­˜ä¸­ï¼Œå“ªäº›åº”è¯¥è¢«æ¸…ç†æ‰ã€‚

```
æ”¹è¿›ç‰ˆLRUç®—æ³•ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LRU List                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”¥ YoungåŒºåŸŸ (çƒ­ç‚¹æ•°æ®) - 5/8                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚ é¡µ1 â”‚â†’â”‚ é¡µ2 â”‚â†’â”‚ é¡µ3 â”‚â†’â”‚ é¡µ4 â”‚â†’ ...        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚
â”‚              â†‘                                  â”‚
â”‚            midpoint                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ§Š OldåŒºåŸŸ (å†·æ•°æ®) - 3/8                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚ é¡µ5 â”‚â†’â”‚ é¡µ6 â”‚â†’â”‚ é¡µ7 â”‚â†’â”‚ é¡µ8 â”‚â†’ ...        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš¡ LRUæ“ä½œæµç¨‹**

```java
// LRUç®—æ³•å…³é”®æ“ä½œç¤ºä¾‹
class BufferPoolLRU {
    
    // é¡µé¢è®¿é—®æ“ä½œ
    public void accessPage(Page page) {
        if (page.isInYoungRegion()) {
            // åœ¨çƒ­ç‚¹åŒºåŸŸï¼Œç§»åˆ°é“¾è¡¨å¤´éƒ¨
            moveToHead(page);
        } else {
            // åœ¨å†·æ•°æ®åŒºåŸŸï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æå‡
            if (page.getAccessTime() > PROMOTION_THRESHOLD) {
                promoteToYoung(page);
            }
        }
    }
    
    // æ·˜æ±°é¡µé¢
    public Page evictPage() {
        // ä»OldåŒºåŸŸå°¾éƒ¨æ·˜æ±°
        return removeFromTail(oldRegion);
    }
}
```

### 3.4 ç¼“å†²æ± çš„ä¼˜åŒ–æœºåˆ¶


**ğŸš€ é¢„è¯»æœºåˆ¶ï¼ˆRead-Aheadï¼‰**

| é¢„è¯»ç±»å‹ | **å·¥ä½œåŸç†** | **è§¦å‘æ¡ä»¶** | **ä¼˜åŠ¿** |
|---------|-------------|-------------|----------|
| **çº¿æ€§é¢„è¯»** | `é¡ºåºè¯»å–åç»­é¡µé¢` | `è¿ç»­è®¿é—®13ä¸ªé¡µé¢` | `æé«˜é¡ºåºæ‰«ææ•ˆç‡` |
| **éšæœºé¢„è¯»** | `é¢„è¯»åŒä¸€extentä¸­çš„é¡µé¢` | `extentä¸­13ä¸ªé¡µé¢è¢«è®¿é—®` | `ä¼˜åŒ–èŒƒå›´æŸ¥è¯¢æ€§èƒ½` |

**ğŸ’¡ é¢„è¯»æœºåˆ¶ç±»æ¯”**
> ğŸŒ° **å°±åƒçœ‹è¿ç»­å‰§**ï¼šå½“ä½ çœ‹åˆ°ç¬¬3é›†æ—¶ï¼Œè§†é¢‘ç½‘ç«™ä¼šè‡ªåŠ¨é¢„åŠ è½½ç¬¬4ã€5é›†ï¼ˆçº¿æ€§é¢„è¯»ï¼‰ï¼›å½“ä½ åœ¨æŸéƒ¨å‰§ä¸­è·³ç€çœ‹äº†å¾ˆå¤šé›†ï¼Œç³»ç»Ÿä¼šé¢„åŠ è½½è¿™éƒ¨å‰§çš„å…¶ä»–å‰§é›†ï¼ˆéšæœºé¢„è¯»ï¼‰ã€‚

---

## 4. ğŸ“¦ å†…å­˜åˆ†é…ç­–ç•¥è¯¦è§£


### 4.1 å†…å­˜åˆ†é…å™¨çš„è®¾è®¡æ€æƒ³


**ğŸ”¸ åˆ†å±‚åˆ†é…ç­–ç•¥**
InnoDBé‡‡ç”¨**åˆ†å±‚åˆ†é…**çš„è®¾è®¡ï¼Œå°±åƒä¸€ä¸ªè´­ç‰©ä¸­å¿ƒçš„æ¥¼å±‚è§„åˆ’ï¼šä¸åŒç±»å‹çš„å•†å“æ”¾åœ¨ä¸åŒæ¥¼å±‚ï¼Œæ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾ã€‚

```
InnoDBå†…å­˜åˆ†é…å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ åº”ç”¨å±‚åˆ†é…å™¨                            â”‚
â”‚    â€¢ SQLæ‰§è¡Œå†…å­˜                          â”‚
â”‚    â€¢ ä¸´æ—¶è¡¨å†…å­˜                           â”‚
â”‚    â€¢ æ’åºå†…å­˜                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¬ ç¼“å­˜å±‚åˆ†é…å™¨                            â”‚  
â”‚    â€¢ é¡µé¢ç¼“å­˜                             â”‚
â”‚    â€¢ ç´¢å¼•ç¼“å­˜                             â”‚
â”‚    â€¢ æ•°æ®å­—å…¸ç¼“å­˜                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸª å¯¹è±¡å±‚åˆ†é…å™¨                            â”‚
â”‚    â€¢ é”å¯¹è±¡æ±                              â”‚
â”‚    â€¢ äº‹åŠ¡å¯¹è±¡æ±                            â”‚
â”‚    â€¢ çº¿ç¨‹å¯¹è±¡æ±                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ  ç³»ç»Ÿå±‚åˆ†é…å™¨                            â”‚
â”‚    â€¢ å†…å­˜æ± ç®¡ç†                           â”‚
â”‚    â€¢ OSæ¥å£å±‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ä¸åŒå¤§å°å†…å­˜çš„åˆ†é…ç­–ç•¥


**ğŸ“ æŒ‰å¤§å°åˆ†ç±»çš„åˆ†é…ç­–ç•¥**

```
å†…å­˜å—å¤§å°åˆ†ç±»å¤„ç†ï¼š

ğŸ”¸ è¶…å¤§å†…å­˜å— (>1MB)ï¼š
   ç­–ç•¥ï¼šç›´æ¥å‘OSç”³è¯·
   ç”¨é€”ï¼šå¤§è¡¨æ‰«æã€æ’åºæ“ä½œ
   å›æ”¶ï¼šä½¿ç”¨å®Œç«‹å³é‡Šæ”¾

ğŸ”¸ å¤§å†…å­˜å— (64KB-1MB)ï¼š
   ç­–ç•¥ï¼šä»å¤§å—å†…å­˜æ± åˆ†é…
   ç”¨é€”ï¼šç¼“å†²æ± é¡µé¢
   å›æ”¶ï¼šå›æ”¶åˆ°å¤§å—æ± ä¸­

ğŸ”¸ ä¸­ç­‰å†…å­˜å— (4KB-64KB)ï¼š
   ç­–ç•¥ï¼šä»ä¸­ç­‰æ± åˆ†é…
   ç”¨é€”ï¼šç´¢å¼•é¡µé¢ã€æ—¥å¿—ç¼“å†²
   å›æ”¶ï¼šå»¶è¿Ÿå›æ”¶ï¼Œæ‰¹é‡å¤„ç†

ğŸ”¸ å°å†…å­˜å— (<4KB)ï¼š
   ç­–ç•¥ï¼šå¯¹è±¡æ± ç®¡ç†
   ç”¨é€”ï¼šé”ã€äº‹åŠ¡æ§åˆ¶å—
   å›æ”¶ï¼šå¿«é€Ÿå›æ”¶ï¼Œé‡å¤ä½¿ç”¨
```

### 4.3 å†…å­˜åˆ†é…ç®—æ³•å®ç°


**ğŸ”§ å…³é”®åˆ†é…ç®—æ³•**

**First Fitï¼ˆé¦–æ¬¡é€‚é…ï¼‰ç®—æ³•ï¼š**
```
ç®—æ³•åŸç†ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—²å—
ä¼˜ç‚¹ï¼šåˆ†é…é€Ÿåº¦å¿«
ç¼ºç‚¹ï¼šå®¹æ˜“äº§ç”Ÿå¤–éƒ¨ç¢ç‰‡

ç©ºé—²å—é“¾è¡¨ï¼š
[10KB] â†’ [25KB] â†’ [8KB] â†’ [40KB] â†’ NULL
éœ€è¦15KBï¼šé€‰æ‹©25KBå—ï¼Œå‰©ä½™10KB
```

**Best Fitï¼ˆæœ€ä½³é€‚é…ï¼‰ç®—æ³•ï¼š**
```
ç®—æ³•åŸç†ï¼šæ‰¾åˆ°æœ€æ¥è¿‘éœ€æ±‚å¤§å°çš„ç©ºé—²å—
ä¼˜ç‚¹ï¼šå‡å°‘å†…éƒ¨ç¢ç‰‡
ç¼ºç‚¹ï¼šæŸ¥æ‰¾æ—¶é—´è¾ƒé•¿

ç©ºé—²å—é“¾è¡¨ï¼ˆæŒ‰å¤§å°æ’åºï¼‰ï¼š
[8KB] â†’ [10KB] â†’ [25KB] â†’ [40KB] â†’ NULL  
éœ€è¦12KBï¼šé€‰æ‹©25KBå—ï¼Œå‰©ä½™13KB
```

**Buddy Systemï¼ˆä¼™ä¼´ç³»ç»Ÿï¼‰ï¼š**
```
ç®—æ³•åŸç†ï¼šæŒ‰2çš„å¹‚æ¬¡åˆ†å‰²å’Œåˆå¹¶å†…å­˜å—
ä¼˜ç‚¹ï¼šå‡å°‘å¤–éƒ¨ç¢ç‰‡ï¼Œåˆå¹¶æ•ˆç‡é«˜
åº”ç”¨ï¼šInnoDBé¡µé¢ç®¡ç†çš„æ ¸å¿ƒç®—æ³•

1MBå†…å­˜å—åˆ†å‰²ç¤ºä¾‹ï¼š
1MB â†’ 512KB + 512KB
512KB â†’ 256KB + 256KB  
256KB â†’ 128KB + 128KB
...
```

### 4.4 å†…å­˜é¢„åˆ†é…ç­–ç•¥


**â° é¢„åˆ†é…æœºåˆ¶**

```
é¢„åˆ†é…ç­–ç•¥ç±»å‹ï¼š

ğŸ”¸ å¯åŠ¨æ—¶é¢„åˆ†é…ï¼š
   â€¢ Buffer Poolï¼šæŒ‰é…ç½®å¤§å°é¢„åˆ†é…
   â€¢ Log Bufferï¼šå›ºå®šå¤§å°é¢„åˆ†é…
   â€¢ æ•°æ®å­—å…¸ç¼“å­˜ï¼šåŠ¨æ€é¢„åˆ†é…

ğŸ”¸ è¿è¡Œæ—¶é¢„åˆ†é…ï¼š  
   â€¢ è¿æ¥å»ºç«‹æ—¶ï¼šé¢„åˆ†é…è¿æ¥ç¼“å†²åŒº
   â€¢ äº‹åŠ¡å¼€å§‹æ—¶ï¼šé¢„åˆ†é…äº‹åŠ¡æ§åˆ¶å—
   â€¢ æŸ¥è¯¢æ‰§è¡Œæ—¶ï¼šé¢„åˆ†é…ä¸´æ—¶å†…å­˜

ğŸ”¸ åŠ¨æ€æ‰©å±•é¢„åˆ†é…ï¼š
   â€¢ å†…å­˜ä½¿ç”¨ç‡>80%ï¼šè§¦å‘æ‰©å±•
   â€¢ æ‰©å±•å¹…åº¦ï¼šå½“å‰å¤§å°çš„25%
   â€¢ æ‰©å±•ä¸Šé™ï¼šé…ç½®çš„æœ€å¤§å€¼
```

---

## 5. ğŸ§® å†…å­˜ç®¡ç†ç®—æ³•å®ç°


### 5.1 æ ¸å¿ƒç®¡ç†ç®—æ³•æ¦‚è¿°


**ğŸ§  InnoDBå†…å­˜ç®¡ç†çš„å¤§è„‘**
InnoDBçš„å†…å­˜ç®¡ç†ç®—æ³•å°±åƒä¸€ä¸ª**è¶…çº§æ™ºèƒ½çš„ä»“åº“ç®¡ç†å‘˜**ï¼Œéœ€è¦åŒæ—¶å¤„ç†è´§ç‰©åˆ†ç±»ã€å­˜å‚¨ä½ç½®ã€è°ƒåº¦ä¼˜å…ˆçº§ç­‰å¤šä¸ªå¤æ‚ä»»åŠ¡ã€‚

```
å†…å­˜ç®¡ç†ç®—æ³•ä½“ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ğŸ¯ è°ƒåº¦ç®—æ³•å±‚                   â”‚
â”‚    â€¢ LRUç¼“å­˜æ›¿æ¢                        â”‚
â”‚    â€¢ æ—¶é’Ÿç®—æ³•ä¼˜åŒ–                       â”‚
â”‚    â€¢ äºŒæ¬¡æœºä¼šç®—æ³•                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ğŸ”„ åˆ†é…ç®—æ³•å±‚                   â”‚
â”‚    â€¢ ä¼™ä¼´ç³»ç»Ÿç®—æ³•                       â”‚
â”‚    â€¢ æ¿å—åˆ†é…ç®—æ³•                       â”‚
â”‚    â€¢ å¯¹è±¡æ± ç®—æ³•                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚          ğŸ§¹ å›æ”¶ç®—æ³•å±‚                   â”‚
â”‚    â€¢ æ ‡è®°æ¸…é™¤ç®—æ³•                       â”‚
â”‚    â€¢ å»¶è¿Ÿå›æ”¶ç®—æ³•                       â”‚
â”‚    â€¢ æ‰¹é‡å›æ”¶ç®—æ³•                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ğŸ” ç›‘æ§ç®—æ³•å±‚                   â”‚
â”‚    â€¢ ä½¿ç”¨ç‡ç»Ÿè®¡                         â”‚
â”‚    â€¢ æ€§èƒ½æŒ‡æ ‡è®¡ç®—                       â”‚
â”‚    â€¢ å¼‚å¸¸æ£€æµ‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 LRUç®—æ³•çš„æ·±åº¦ä¼˜åŒ–


**âš¡ æ”¹è¿›ç‰ˆLRUç®—æ³•å®ç°**

ä¼ ç»ŸLRUç®—æ³•å­˜åœ¨çš„é—®é¢˜ï¼š
- **ç¼“å­˜æ±¡æŸ“**ï¼šå¤§é‡å†·æ•°æ®ä¸€æ¬¡æ€§è¯»å–ä¼šæ±¡æŸ“ç¼“å­˜
- **é¡ºåºæ‰«æé—®é¢˜**ï¼šå…¨è¡¨æ‰«æä¼šæŠŠçƒ­ç‚¹æ•°æ®æŒ¤å‡ºç¼“å­˜

**InnoDBçš„è§£å†³æ–¹æ¡ˆï¼š**

```java
class ImprovedLRU {
    
    // åˆ†æ®µLRUé“¾è¡¨
    private LRUList youngList;  // çƒ­ç‚¹æ•°æ®åŒº
    private LRUList oldList;    // å†·æ•°æ®åŒº
    
    // å…³é”®å‚æ•°
    private static final double OLD_BLOCKS_PCT = 0.375; // oldåŒºå æ¯”37.5%
    private static final int OLD_BLOCKS_TIME = 1000;    // æå‡åˆ°youngåŒºçš„æ—¶é—´é˜ˆå€¼
    
    public void accessPage(BufferBlock block) {
        if (block.isInOldList()) {
            // åœ¨oldåŒºåŸŸä¸­
            if (System.currentTimeMillis() - block.getFirstAccess() > OLD_BLOCKS_TIME) {
                // æ»¡è¶³æ—¶é—´æ¡ä»¶ï¼Œæå‡åˆ°youngåŒº
                moveToYoungList(block);
            }
        } else {
            // åœ¨youngåŒºåŸŸä¸­ï¼Œç§»åˆ°å¤´éƒ¨
            youngList.moveToHead(block);
        }
    }
    
    // é¡µé¢æ·˜æ±°ç­–ç•¥
    public BufferBlock evictPage() {
        // ä¼˜å…ˆä»oldåŒºåŸŸå°¾éƒ¨æ·˜æ±°
        if (!oldList.isEmpty()) {
            return oldList.removeTail();
        }
        // oldåŒºä¸ºç©ºæ—¶æ‰ä»youngåŒºæ·˜æ±°  
        return youngList.removeTail();
    }
}
```

### 5.3 å†…å­˜åˆ†é…ç®—æ³•çš„å…·ä½“å®ç°


**ğŸ”§ ä¼™ä¼´ç³»ç»Ÿç®—æ³•è¯¦è§£**

ä¼™ä¼´ç³»ç»Ÿæ˜¯InnoDBå†…å­˜ç®¡ç†çš„æ ¸å¿ƒç®—æ³•ï¼Œç‰¹åˆ«é€‚åˆé¡µé¢çº§åˆ«çš„å†…å­˜ç®¡ç†ã€‚

```
ä¼™ä¼´ç³»ç»Ÿå·¥ä½œåŸç†ï¼š

åˆå§‹çŠ¶æ€ï¼ˆ1MBå—ï¼‰ï¼š
[1MBç©ºé—²]

åˆ†é…16KBï¼š
1MB â†’ 512KB + 512KB
512KB â†’ 256KB + 256KB  
256KB â†’ 128KB + 128KB
128KB â†’ 64KB + 64KB
64KB â†’ 32KB + 32KB
32KB â†’ 16KB + 16KB

ç»“æœï¼šåˆ†é…16KBï¼Œå‰©ä½™16KB + 32KB + 64KB + ... + 512KB
```

**å®ç°ä»£ç ç¤ºä¾‹ï¼š**

```java
class BuddySystem {
    
    // ç©ºé—²å—é“¾è¡¨æ•°ç»„ï¼Œindexè¡¨ç¤º2^indexå¤§å°çš„å—
    private List<FreeBlock>[] freeList;
    private static final int MAX_ORDER = 20; // æœ€å¤§æ”¯æŒ1MB
    
    // åˆ†é…å†…å­˜
    public MemoryBlock allocate(int size) {
        int order = getOrder(size);
        
        // å¯»æ‰¾åˆé€‚å¤§å°çš„ç©ºé—²å—
        for (int i = order; i < MAX_ORDER; i++) {
            if (!freeList[i].isEmpty()) {
                FreeBlock block = freeList[i].removeFirst();
                
                // å¦‚æœå—å¤ªå¤§ï¼Œéœ€è¦åˆ†å‰²
                while (i > order) {
                    i--;
                    FreeBlock buddy = block.split();
                    freeList[i].add(buddy);
                }
                
                return block.toMemoryBlock();
            }
        }
        
        return null; // å†…å­˜ä¸è¶³
    }
    
    // é‡Šæ”¾å†…å­˜
    public void deallocate(MemoryBlock block) {
        int order = getOrder(block.size());
        FreeBlock freeBlock = new FreeBlock(block);
        
        // å°è¯•ä¸ä¼™ä¼´å—åˆå¹¶
        while (order < MAX_ORDER - 1) {
            FreeBlock buddy = findBuddy(freeBlock);
            if (buddy != null && freeList[order].contains(buddy)) {
                // æ‰¾åˆ°ä¼™ä¼´ä¸”ç©ºé—²ï¼Œè¿›è¡Œåˆå¹¶
                freeList[order].remove(buddy);
                freeBlock = merge(freeBlock, buddy);
                order++;
            } else {
                break;
            }
        }
        
        freeList[order].add(freeBlock);
    }
}
```

### 5.4 å¯¹è±¡æ± ç®—æ³•


**ğŸŠâ€â™‚ï¸ å¯¹è±¡æ± ç®¡ç†ç­–ç•¥**

å¯¹è±¡æ± ä¸“é—¨ç”¨äºç®¡ç†å°å¯¹è±¡çš„åˆ†é…å’Œå›æ”¶ï¼Œé¿å…é¢‘ç¹çš„å†…å­˜ç”³è¯·é‡Šæ”¾ã€‚

```
å¯¹è±¡æ± ç»“æ„è®¾è®¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¯¹è±¡æ± ç®¡ç†å™¨                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”’ é”å¯¹è±¡æ±                              â”‚
â”‚    â€¢ é¢„åˆ†é…1000ä¸ªé”å¯¹è±¡                 â”‚
â”‚    â€¢ ç©ºé—²é“¾è¡¨ç®¡ç†                       â”‚
â”‚    â€¢ æ‰©å±•é˜ˆå€¼ï¼šç©ºé—²å¯¹è±¡<100ä¸ª            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ äº‹åŠ¡å¯¹è±¡æ±                            â”‚
â”‚    â€¢ é¢„åˆ†é…500ä¸ªäº‹åŠ¡æ§åˆ¶å—              â”‚
â”‚    â€¢ æŒ‰è¿æ¥æ•°åŠ¨æ€è°ƒæ•´                   â”‚
â”‚    â€¢ å›æ”¶å»¶è¿Ÿï¼šäº‹åŠ¡ç»“æŸå5åˆ†é’Ÿ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ§µ çº¿ç¨‹å¯¹è±¡æ±                            â”‚
â”‚    â€¢ å·¥ä½œçº¿ç¨‹æ±                          â”‚
â”‚    â€¢ IOçº¿ç¨‹æ±                           â”‚
â”‚    â€¢ æ¸…ç†çº¿ç¨‹æ±                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ğŸ§½ å†…å­˜ç¢ç‰‡æ£€æµ‹ä¸æ•´ç†


### 6.1 å†…å­˜ç¢ç‰‡äº§ç”Ÿçš„åŸå› 


**ğŸ”¸ ä»€ä¹ˆæ˜¯å†…å­˜ç¢ç‰‡**
å†…å­˜ç¢ç‰‡å°±åƒæ˜¯æ‹¼å›¾æ¸¸æˆä¸­çš„**ç©ºéš™**ã€‚è™½ç„¶æ€»çš„ç©ºé—´å¤Ÿç”¨ï¼Œä½†éƒ½æ˜¯å°å—åˆ†æ•£çš„ç©ºé—´ï¼Œæ— æ³•æ»¡è¶³å¤§å—å†…å­˜çš„ç”³è¯·éœ€æ±‚ã€‚

> ğŸŒ° **ç”Ÿæ´»ç±»æ¯”**ï¼šæƒ³è±¡ä½ çš„è¡£æŸœï¼Œè™½ç„¶æ€»ç©ºé—´å¾ˆå¤§ï¼Œä½†å› ä¸ºè¡£æœæ‘†æ”¾ä¸æ•´é½ï¼Œå¤§ä»¶è¡£æœå°±æ”¾ä¸è¿›å»äº†ã€‚å†…å­˜ç¢ç‰‡å°±æ˜¯è¿™æ ·çš„é“ç†ã€‚

```
å†…å­˜ç¢ç‰‡ç±»å‹ï¼š

ğŸ”¸ å¤–éƒ¨ç¢ç‰‡ï¼š
   ç©ºé—²å†…å­˜åˆ†æ•£åœ¨å„å¤„ï¼Œæ€»é‡å¤Ÿç”¨ä½†ä¸è¿ç»­
   [å·²ç”¨][ç©ºé—²5K][å·²ç”¨][ç©ºé—²3K][å·²ç”¨][ç©ºé—²8K]
   éœ€è¦10Kè¿ç»­å†…å­˜ â†’ å¤±è´¥ï¼ˆè™½ç„¶ç©ºé—²æ€»é‡16K>10Kï¼‰

ğŸ”¸ å†…éƒ¨ç¢ç‰‡ï¼š
   åˆ†é…çš„å†…å­˜å—å¤§äºå®é™…éœ€æ±‚
   éœ€è¦7Kï¼Œåˆ†é…äº†8K â†’ 1Kå†…éƒ¨ç¢ç‰‡
```

### 6.2 ç¢ç‰‡æ£€æµ‹ç®—æ³•


**ğŸ” ç¢ç‰‡æ£€æµ‹æŒ‡æ ‡**

```java
class FragmentationDetector {
    
    // ç¢ç‰‡ç‡è®¡ç®—
    public double calculateFragmentation() {
        long totalFree = getTotalFreeMemory();
        long largestFreeBlock = getLargestFreeBlock();
        
        // ç¢ç‰‡ç‡ = 1 - (æœ€å¤§ç©ºé—²å— / æ€»ç©ºé—²å†…å­˜)
        return 1.0 - (double)largestFreeBlock / totalFree;
    }
    
    // å…³é”®æ£€æµ‹æŒ‡æ ‡
    public FragmentationReport generateReport() {
        return FragmentationReport.builder()
            .fragmentationRatio(calculateFragmentation())
            .freeBlockCount(countFreeBlocks())
            .averageFreeBlockSize(calculateAverageFreeBlockSize())
            .largestFreeBlock(getLargestFreeBlock())
            .allocationFailureRate(getAllocationFailureRate())
            .build();
    }
}
```

**ğŸ“Š ç¢ç‰‡æ£€æµ‹é˜ˆå€¼**

| æŒ‡æ ‡ | **æ­£å¸¸èŒƒå›´** | **è­¦å‘Šé˜ˆå€¼** | **å±é™©é˜ˆå€¼** | **å¤„ç†å»ºè®®** |
|------|-------------|-------------|-------------|-------------|
| **ç¢ç‰‡ç‡** | `< 20%` | `20-40%` | `> 40%` | `ç«‹å³è¿›è¡Œç¢ç‰‡æ•´ç†` |
| **å¹³å‡ç©ºé—²å—å¤§å°** | `> 64KB` | `32-64KB` | `< 32KB` | `å¢åŠ å†…å­˜æ± å¤§å°` |
| **åˆ†é…å¤±è´¥ç‡** | `< 1%` | `1-5%` | `> 5%` | `é‡å¯æœåŠ¡æˆ–æ‰©å®¹` |

### 6.3 ç¢ç‰‡æ•´ç†ç®—æ³•


**ğŸ”§ å‹ç¼©æ•´ç†ç®—æ³•**

InnoDBé‡‡ç”¨**æ ‡è®°-å‹ç¼©**ç®—æ³•è¿›è¡Œç¢ç‰‡æ•´ç†ï¼š

```
æ•´ç†è¿‡ç¨‹ç¤ºæ„ï¼š

æ•´ç†å‰ï¼š
[æ•°æ®A][ç©ºé—²][æ•°æ®B][ç©ºé—²][æ•°æ®C][ç©ºé—²][æ•°æ®D]

ç¬¬ä¸€æ­¥ï¼šæ ‡è®°å­˜æ´»æ•°æ®
[æ•°æ®A*][ç©ºé—²][æ•°æ®B*][ç©ºé—²][æ•°æ®C*][ç©ºé—²][æ•°æ®D*]

ç¬¬äºŒæ­¥ï¼šå‹ç¼©ç§»åŠ¨
[æ•°æ®A][æ•°æ®B][æ•°æ®C][æ•°æ®D][------ç©ºé—²åŒºåŸŸ------]

æ•´ç†åï¼šè·å¾—ä¸€å¤§å—è¿ç»­ç©ºé—²å†…å­˜
```

**å®ç°ç­–ç•¥ï¼š**

```java
class MemoryDefragmenter {
    
    // åˆ†é˜¶æ®µæ•´ç†ç­–ç•¥
    public void defragment() {
        if (isSystemBusy()) {
            // ç³»ç»Ÿç¹å¿™æ—¶ï¼šè½»é‡çº§æ•´ç†
            lightweightDefrag();
        } else {
            // ç³»ç»Ÿç©ºé—²æ—¶ï¼šå®Œæ•´æ•´ç†
            fullDefrag();
        }
    }
    
    // è½»é‡çº§æ•´ç†ï¼šåªæ•´ç†å°å—
    private void lightweightDefrag() {
        // åˆå¹¶ç›¸é‚»çš„å°ç©ºé—²å—
        mergeAdjacentFreeBlocks(MAX_SMALL_BLOCK_SIZE);
    }
    
    // å®Œæ•´æ•´ç†ï¼šç§»åŠ¨æ•°æ®ï¼Œå½»åº•æ•´ç†
    private void fullDefrag() {
        // 1. æš‚åœæ–°çš„å†…å­˜åˆ†é…
        pauseAllocation();
        
        try {
            // 2. æ ‡è®°å­˜æ´»çš„å†…å­˜å—
            Set<MemoryBlock> aliveBlocks = markAliveBlocks();
            
            // 3. å‹ç¼©ç§»åŠ¨æ•°æ®
            compactMemory(aliveBlocks);
            
            // 4. é‡å»ºç©ºé—²é“¾è¡¨
            rebuildFreeList();
            
        } finally {
            // 5. æ¢å¤å†…å­˜åˆ†é…
            resumeAllocation();
        }
    }
}
```

### 6.4 é¢„é˜²ç¢ç‰‡äº§ç”Ÿçš„ç­–ç•¥


**ğŸ›¡ï¸ é¢„é˜²æªæ–½**

```
ç¢ç‰‡é¢„é˜²ç­–ç•¥ï¼š

ğŸ”¸ å†…å­˜æ± åˆ†çº§ï¼š
   â€¢ ä¸åŒå¤§å°çš„å†…å­˜éœ€æ±‚ä½¿ç”¨ä¸åŒçš„å†…å­˜æ± 
   â€¢ å‡å°‘å¤§å°å·®å¼‚è¿‡å¤§çš„å†…å­˜å—æ··åˆä½¿ç”¨

ğŸ”¸ å»¶è¿Ÿåˆå¹¶ï¼š
   â€¢ é‡Šæ”¾çš„å†…å­˜ä¸ç«‹å³åˆå¹¶
   â€¢ ç§¯ç´¯ä¸€å®šæ•°é‡åæ‰¹é‡åˆå¹¶
   â€¢ å‡å°‘é¢‘ç¹åˆå¹¶çš„å¼€é”€

ğŸ”¸ é¢„åˆ†é…ç­–ç•¥ï¼š
   â€¢ ç³»ç»Ÿå¯åŠ¨æ—¶é¢„åˆ†é…å¸¸ç”¨å¤§å°çš„å†…å­˜å—
   â€¢ å‡å°‘è¿è¡Œæ—¶çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾

ğŸ”¸ å¯¹è±¡æ± åŒ–ï¼š
   â€¢ ç›¸åŒç±»å‹çš„å¯¹è±¡ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†
   â€¢ é¿å…é¢‘ç¹çš„åˆ†é…å’Œé‡Šæ”¾
```

---

## 7. ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 7.1 å†…å­˜è®¿é—®æ€§èƒ½ä¼˜åŒ–


**âš¡ ç¼“å­˜å‹å¥½çš„å†…å­˜å¸ƒå±€**

ç°ä»£CPUçš„ç¼“å­˜æœºåˆ¶å¯¹å†…å­˜è®¿é—®æ€§èƒ½å½±å“å·¨å¤§ã€‚InnoDBé€šè¿‡ä¼˜åŒ–å†…å­˜å¸ƒå±€æ¥æå‡ç¼“å­˜å‘½ä¸­ç‡ã€‚

```
CPUç¼“å­˜å±‚æ¬¡ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’» CPU Core                            â”‚
â”‚    â”œâ”€ L1 Cache (32KB, 1-2 cycles)      â”‚
â”‚    â”œâ”€ L2 Cache (256KB, 3-10 cycles)    â”‚
â”‚    â””â”€ L3 Cache (8MB, 10-50 cycles)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§  Main Memory (GBçº§åˆ«, 100+ cycles)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¾ Disk Storage (TBçº§åˆ«, 10ä¸‡+ cycles) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ ä¼˜åŒ–ç­–ç•¥ï¼š**

```java
// ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„è®¾è®¡
class CacheFriendlyBufferPool {
    
    // é¡µé¢æ§åˆ¶å—æ•°ç»„ï¼šè¿ç»­å†…å­˜ï¼Œç¼“å­˜å‹å¥½
    private BufferControlBlock[] controlBlocks;
    
    // é¡µé¢æ•°æ®åŒºï¼šä¸æ§åˆ¶å—åˆ†ç¦»ï¼Œå‡å°‘ç¼“å­˜æ±¡æŸ“
    private byte[] dataPages;
    
    // å“ˆå¸Œè¡¨ï¼šå¿«é€Ÿå®šä½é¡µé¢
    private HashTable<PageId, Integer> pageTable;
    
    public BufferPage getPage(PageId pageId) {
        // 1. å“ˆå¸ŒæŸ¥æ‰¾æ§åˆ¶å—ç´¢å¼•ï¼ˆç¼“å­˜å‹å¥½ï¼‰
        Integer blockIndex = pageTable.get(pageId);
        if (blockIndex == null) return null;
        
        // 2. é€šè¿‡ç´¢å¼•ç›´æ¥è®¿é—®æ§åˆ¶å—ï¼ˆç¼“å­˜å‘½ä¸­ç‡é«˜ï¼‰
        BufferControlBlock block = controlBlocks[blockIndex];
        
        // 3. æ›´æ–°LRUä¿¡æ¯ï¼ˆæ‰¹é‡æ›´æ–°ï¼Œå‡å°‘ç¼“å­˜æœªå‘½ä¸­ï¼‰
        updateLRUInfo(block);
        
        return block.getPage();
    }
}
```

### 7.2 å¤šçº¿ç¨‹ä¼˜åŒ–ç­–ç•¥


**ğŸ§µ å‡å°‘é”ç«äº‰çš„è®¾è®¡**

```
å¤šçº¿ç¨‹è®¿é—®ä¼˜åŒ–ï¼š

ğŸ”¸ è¯»å†™é”åˆ†ç¦»ï¼š
   â€¢ è¯»æ“ä½œï¼šå…±äº«é”ï¼ˆå¤šçº¿ç¨‹å¹¶å‘ï¼‰
   â€¢ å†™æ“ä½œï¼šæ’ä»–é”ï¼ˆå•çº¿ç¨‹ç‹¬å ï¼‰
   â€¢ å‡å°‘è¯»è¯»ä¹‹é—´çš„ç«äº‰

ğŸ”¸ é”ç²’åº¦ç»†åŒ–ï¼š
   â€¢ é¡µçº§é”ï¼šæ›¿ä»£è¡¨çº§é”
   â€¢ åˆ†æ®µé”ï¼šå“ˆå¸Œè¡¨åˆ†æ®µåŠ é”
   â€¢ æ— é”ç®—æ³•ï¼šCASæ“ä½œ

ğŸ”¸ é”é¡ºåºè§„èŒƒï¼š
   â€¢ é¿å…æ­»é”çš„å›ºå®šåŠ é”é¡ºåº
   â€¢ é”å‡çº§æœºåˆ¶
   â€¢ è¶…æ—¶æœºåˆ¶
```

**å®ç°ç¤ºä¾‹ï¼š**

```java
class ConcurrentBufferPool {
    
    // åˆ†æ®µé”ï¼šå‡å°‘ç«äº‰
    private final ReadWriteLock[] segmentLocks;
    private final int SEGMENT_COUNT = 16;
    
    // æ— é”çš„ç»Ÿè®¡ä¿¡æ¯
    private final AtomicLong hitCount = new AtomicLong(0);
    private final AtomicLong missCount = new AtomicLong(0);
    
    public BufferPage getPage(PageId pageId) {
        int segment = pageId.hashCode() % SEGMENT_COUNT;
        ReadWriteLock lock = segmentLocks[segment];
        
        // è¯»é”ï¼šå…è®¸å¤šçº¿ç¨‹å¹¶å‘è®¿é—®
        lock.readLock().lock();
        try {
            BufferPage page = findPageInSegment(pageId, segment);
            if (page != null) {
                hitCount.incrementAndGet(); // æ— é”æ›´æ–°
                return page;
            }
        } finally {
            lock.readLock().unlock();
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼Œéœ€è¦ä»ç£ç›˜åŠ è½½
        return loadPageFromDisk(pageId, segment);
    }
    
    private BufferPage loadPageFromDisk(PageId pageId, int segment) {
        ReadWriteLock lock = segmentLocks[segment];
        
        // å†™é”ï¼šç‹¬å è®¿é—®
        lock.writeLock().lock();
        try {
            // Double-checkï¼šå¯èƒ½å…¶ä»–çº¿ç¨‹å·²ç»åŠ è½½äº†
            BufferPage page = findPageInSegment(pageId, segment);
            if (page != null) {
                return page;
            }
            
            // çœŸæ­£ä»ç£ç›˜åŠ è½½
            page = diskIO.readPage(pageId);
            addPageToSegment(page, segment);
            missCount.incrementAndGet();
            
            return page;
        } finally {
            lock.writeLock().unlock();
        }
    }
}
```

### 7.3 I/Oæ€§èƒ½ä¼˜åŒ–


**ğŸ’¾ å¼‚æ­¥I/Oä¸é¢„è¯»ä¼˜åŒ–**

```
I/Oä¼˜åŒ–ç­–ç•¥ç»„åˆï¼š

ğŸ”¸ å¼‚æ­¥I/Oï¼š
   â€¢ éé˜»å¡ç£ç›˜æ“ä½œ
   â€¢ æ“ä½œç³»ç»Ÿå¼‚æ­¥I/Oæ¥å£
   â€¢ I/Oå®Œæˆç«¯å£æ¨¡å‹

ğŸ”¸ æ‰¹é‡I/Oï¼š
   â€¢ å¤šä¸ªé¡µé¢ä¸€æ¬¡æ€§è¯»å†™
   â€¢ å‡å°‘ç³»ç»Ÿè°ƒç”¨å¼€é”€
   â€¢ æé«˜ç£ç›˜å¸¦å®½åˆ©ç”¨ç‡

ğŸ”¸ æ™ºèƒ½é¢„è¯»ï¼š
   â€¢ çº¿æ€§é¢„è¯»ï¼šé¡ºåºè®¿é—®æ¨¡å¼æ£€æµ‹
   â€¢ éšæœºé¢„è¯»ï¼šè®¿é—®çƒ­ç‚¹æ£€æµ‹
   â€¢ è‡ªé€‚åº”é¢„è¯»ï¼šæ ¹æ®å‘½ä¸­ç‡è°ƒæ•´
```

### 7.4 å†…å­˜ä½¿ç”¨æ•ˆç‡ä¼˜åŒ–


**ğŸ“Š å†…å­˜å‹ç¼©å’Œä¼˜åŒ–æŠ€æœ¯**

```java
class MemoryOptimizer {
    
    // é¡µé¢å‹ç¼©ï¼šèŠ‚çœå†…å­˜ç©ºé—´
    public CompressedPage compressPage(RawPage rawPage) {
        // 1. é€‰æ‹©åˆé€‚çš„å‹ç¼©ç®—æ³•
        CompressionAlgorithm algorithm = selectCompressionAlgorithm(rawPage);
        
        // 2. å‹ç¼©æ•°æ®
        byte[] compressedData = algorithm.compress(rawPage.getData());
        
        // 3. å¦‚æœå‹ç¼©æ•ˆæœä¸å¥½ï¼Œä¿æŒåŸçŠ¶
        if (compressedData.length > rawPage.getData().length * 0.85) {
            return new CompressedPage(rawPage.getData(), false);
        }
        
        return new CompressedPage(compressedData, true);
    }
    
    // å†…å­˜å»é‡ï¼šç›¸åŒå†…å®¹çš„é¡µé¢å…±äº«
    private Map<byte[], WeakReference<BufferPage>> pageDeduplication = new ConcurrentHashMap<>();
    
    public BufferPage deduplicatePage(byte[] pageData) {
        byte[] hash = calculateHash(pageData);
        WeakReference<BufferPage> existingPageRef = pageDeduplication.get(hash);
        
        if (existingPageRef != null) {
            BufferPage existingPage = existingPageRef.get();
            if (existingPage != null && Arrays.equals(existingPage.getData(), pageData)) {
                // æ‰¾åˆ°ç›¸åŒçš„é¡µé¢ï¼Œç›´æ¥è¿”å›å¼•ç”¨
                return existingPage;
            }
        }
        
        // åˆ›å»ºæ–°é¡µé¢å¹¶åŠ å…¥å»é‡æ˜ å°„
        BufferPage newPage = new BufferPage(pageData);
        pageDeduplication.put(hash, new WeakReference<>(newPage));
        return newPage;
    }
}
```

---

## 8. ğŸ–¥ï¸ NUMAæ¶æ„ä¼˜åŒ–


### 8.1 NUMAæ¶æ„åŸºç¡€


**ğŸ”¸ ä»€ä¹ˆæ˜¯NUMA**
NUMAï¼ˆNon-Uniform Memory Accessï¼‰å°±åƒæ˜¯ä¸€ä¸ª**å¤šåŒºåŸŸçš„å¤§å‹å•†åœº**ã€‚æ¯ä¸ªCPUæ ¸å¿ƒå°±åƒæ˜¯ä¸€ä¸ªå•†åœºåŒºåŸŸï¼Œéƒ½æœ‰è‡ªå·±å°±è¿‘çš„å†…å­˜ï¼ˆæœ¬åœ°å•†å“ï¼‰ï¼Œä½†ä¹Ÿå¯ä»¥è®¿é—®è¿œç¨‹å†…å­˜ï¼ˆå…¶ä»–åŒºåŸŸçš„å•†å“ï¼‰ã€‚

```
NUMAæ¶æ„ç¤ºæ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NUMA Node 0                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ CPU 0   â”‚  â”‚ CPU 1   â”‚     â”‚ Local Memory â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   (å¿«é€Ÿè®¿é—®)  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                              â”‚
        æ€»çº¿è¿æ¥                     è·¨NUMAè®¿é—®
           â”‚                          (è¾ƒæ…¢)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NUMA Node 1                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  
â”‚  â”‚ CPU 2   â”‚  â”‚ CPU 3   â”‚     â”‚ Local Memory â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   (å¿«é€Ÿè®¿é—®)  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 NUMAå¯¹æ•°æ®åº“æ€§èƒ½çš„å½±å“


**ğŸ“Š æ€§èƒ½å·®å¼‚å¯¹æ¯”**

| è®¿é—®ç±»å‹ | **å»¶è¿Ÿ** | **å¸¦å®½** | **å¯¹æ€§èƒ½çš„å½±å“** |
|---------|---------|---------|-----------------|
| **æœ¬åœ°NUMAè®¿é—®** | `~80ns` | `~25GB/s` | `åŸºå‡†æ€§èƒ½` |
| **è·¨NUMAè®¿é—®** | `~120ns` | `~15GB/s` | `æ€§èƒ½ä¸‹é™30-50%` |
| **è¿œç¨‹NUMAè®¿é—®** | `~200ns` | `~8GB/s` | `æ€§èƒ½ä¸‹é™60-80%` |

> ğŸŒ° **ç”Ÿæ´»ç±»æ¯”**ï¼šæœ¬åœ°NUMAè®¿é—®å°±åƒåœ¨ä½ å±…ä½çš„å°åŒºè¶…å¸‚ä¹°ä¸œè¥¿ï¼Œè·¨NUMAè®¿é—®å°±åƒå»éš”å£å°åŒºï¼Œè¿œç¨‹NUMAè®¿é—®å°±åƒè·¨åŸå¸‚è´­ç‰© - è·ç¦»è¶Šè¿œï¼Œæ—¶é—´æˆæœ¬è¶Šé«˜ã€‚

### 8.3 InnoDBçš„NUMAä¼˜åŒ–ç­–ç•¥


**ğŸ¯ å†…å­˜äº²å’Œæ€§ç»‘å®š**

```java
class NUMAOptimizer {
    
    // NUMAèŠ‚ç‚¹ä¿¡æ¯
    private List<NUMANode> numaNodes;
    private Map<Thread, NUMANode> threadNodeBinding;
    
    // åˆå§‹åŒ–NUMAä¼˜åŒ–
    public void initNUMAOptimization() {
        // 1. æ£€æµ‹NUMAæ‹“æ‰‘
        numaNodes = detectNUMATopology();
        
        // 2. é…ç½®å†…å­˜ç­–ç•¥
        configureMemoryPolicy();
        
        // 3. ç»‘å®šå·¥ä½œçº¿ç¨‹åˆ°NUMAèŠ‚ç‚¹
        bindThreadsToNUMANodes();
    }
    
    // æ™ºèƒ½å†…å­˜åˆ†é…
    public MemoryBlock allocateMemory(int size, Thread requestThread) {
        // è·å–çº¿ç¨‹ç»‘å®šçš„NUMAèŠ‚ç‚¹
        NUMANode preferredNode = threadNodeBinding.get(requestThread);
        
        if (preferredNode != null) {
            // ä¼˜å…ˆä»æœ¬åœ°NUMAèŠ‚ç‚¹åˆ†é…
            MemoryBlock localBlock = preferredNode.allocateLocal(size);
            if (localBlock != null) {
                return localBlock;
            }
        }
        
        // æœ¬åœ°åˆ†é…å¤±è´¥ï¼ŒæŒ‰è·ç¦»é€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹
        return allocateFromNearestNode(size, preferredNode);
    }
    
    // ç¼“å†²æ± NUMAä¼˜åŒ–
    public void optimizeBufferPool() {
        int totalBufferSize = getBufferPoolSize();
        int nodeCount = numaNodes.size();
        int sizePerNode = totalBufferSize / nodeCount;
        
        for (int i = 0; i < nodeCount; i++) {
            NUMANode node = numaNodes.get(i);
            
            // åœ¨æ¯ä¸ªNUMAèŠ‚ç‚¹ä¸Šåˆ†é…ç¼“å†²æ± 
            BufferPoolInstance instance = new BufferPoolInstance(sizePerNode);
            node.allocateBufferPool(instance);
            
            // ç»‘å®šå·¥ä½œçº¿ç¨‹åˆ°å¯¹åº”çš„ç¼“å†²æ± å®ä¾‹
            bindWorkersToBufferPool(node.getWorkerThreads(), instance);
        }
    }
}
```

### 8.4 NUMAæ„ŸçŸ¥çš„è¿æ¥ç®¡ç†


**ğŸ”— è¿æ¥çº¿ç¨‹çš„NUMAä¼˜åŒ–**

```
è¿æ¥NUMAç»‘å®šç­–ç•¥ï¼š

ğŸ”¸ è½®è¯¢ç»‘å®šï¼š
   â€¢ æ–°è¿æ¥æŒ‰è½®è¯¢æ–¹å¼åˆ†é…åˆ°ä¸åŒNUMAèŠ‚ç‚¹
   â€¢ ç¡®ä¿è´Ÿè½½å‡è¡¡
   â€¢ é€‚åˆè¿æ¥æ•°è¾ƒå¤šçš„åœºæ™¯

ğŸ”¸ äº²å’Œæ€§ç»‘å®šï¼š
   â€¢ ç›¸å…³çš„è¿æ¥ç»‘å®šåˆ°åŒä¸€NUMAèŠ‚ç‚¹  
   â€¢ æé«˜ç¼“å­˜å±€éƒ¨æ€§
   â€¢ é€‚åˆæœ‰ä¸šåŠ¡å…³è”çš„è¿æ¥

ğŸ”¸ åŠ¨æ€è°ƒæ•´ï¼š
   â€¢ æ ¹æ®è´Ÿè½½æƒ…å†µåŠ¨æ€è°ƒæ•´ç»‘å®š
   â€¢ é¿å…æŸä¸ªNUMAèŠ‚ç‚¹è¿‡è½½
   â€¢ å®ç°è´Ÿè½½å‡è¡¡
```

---

## 9. ğŸ“Š å†…å­˜ç›‘æ§ä¸è°ƒè¯•


### 9.1 å†…å­˜ä½¿ç”¨ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡ä½“ç³»**

```
InnoDBå†…å­˜ç›‘æ§ä»ªè¡¨ç›˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸ“Š å†…å­˜æ€»è§ˆ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ æ€»å†…å­˜ä½¿ç”¨ç‡: 78.5%        ğŸ”´ å†…å­˜æ³„æ¼æ£€æµ‹: æ­£å¸¸  â”‚
â”‚ ğŸŸ¡ ç¼“å†²æ± å‘½ä¸­ç‡: 99.2%        âš¡ å†…å­˜åˆ†é…é€Ÿåº¦: 1.2ms â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  ğŸ“‹ è¯¦ç»†æŒ‡æ ‡                         â”‚
â”‚ â€¢ Buffer Poolä½¿ç”¨: 15.2GB / 16GB (95%)              â”‚
â”‚ â€¢ Log Bufferä½¿ç”¨: 45MB / 64MB (70%)                 â”‚
â”‚ â€¢ æ•°æ®å­—å…¸ç¼“å­˜: 128MB / 256MB (50%)                  â”‚
â”‚ â€¢ è¿æ¥ç¼“å†²åŒº: 89MB / 128MB (70%)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  ğŸ” æ€§èƒ½æŒ‡æ ‡                         â”‚
â”‚ â€¢ é¡µé¢æ¢å‡ºç‡: 0.5 pages/sec                         â”‚
â”‚ â€¢ å†…å­˜ç¢ç‰‡ç‡: 12.3%                                 â”‚
â”‚ â€¢ NUMAè·¨èŠ‚ç‚¹è®¿é—®ç‡: 8.2%                            â”‚
â”‚ â€¢ å†…å­˜åˆ†é…å¤±è´¥ç‡: 0.01%                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 å®æ—¶ç›‘æ§å®ç°


**ğŸ”§ ç›‘æ§ç³»ç»Ÿæ¶æ„**

```java
class MemoryMonitor {
    
    // ç›‘æ§æŒ‡æ ‡æ”¶é›†å™¨
    private MetricsCollector metricsCollector;
    
    // ç›‘æ§é…ç½®
    private static final int MONITOR_INTERVAL_MS = 1000; // 1ç§’é‡‡é›†ä¸€æ¬¡
    private static final int HISTORY_RETENTION_HOURS = 24; // ä¿ç•™24å°æ—¶å†å²
    
    // å…³é”®æŒ‡æ ‡å®šä¹‰
    public enum MemoryMetric {
        BUFFER_POOL_USAGE("buffer_pool_usage_ratio"),
        CACHE_HIT_RATIO("cache_hit_ratio"),
        MEMORY_FRAGMENTATION("memory_fragmentation_ratio"),
        ALLOCATION_FAILURE_RATE("allocation_failure_rate"),
        NUMA_CROSS_ACCESS_RATE("numa_cross_access_rate");
        
        private final String metricName;
        
        MemoryMetric(String metricName) {
            this.metricName = metricName;
        }
    }
    
    // å¼€å§‹ç›‘æ§
    public void startMonitoring() {
        ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);
        
        scheduler.scheduleAtFixedRate(() -> {
            try {
                // æ”¶é›†æ‰€æœ‰å†…å­˜æŒ‡æ ‡
                MemorySnapshot snapshot = collectMemorySnapshot();
                
                // è®¡ç®—æ€§èƒ½æŒ‡æ ‡
                PerformanceMetrics performance = calculatePerformance(snapshot);
                
                // æ£€æŸ¥å‘Šè­¦æ¡ä»¶
                checkAlerts(performance);
                
                // å­˜å‚¨å†å²æ•°æ®
                storeMetrics(snapshot, performance);
                
            } catch (Exception e) {
                logger.error("Memory monitoring failed", e);
            }
        }, 0, MONITOR_INTERVAL_MS, TimeUnit.MILLISECONDS);
    }
    
    // æ”¶é›†å†…å­˜å¿«ç…§
    private MemorySnapshot collectMemorySnapshot() {
        return MemorySnapshot.builder()
            .timestamp(System.currentTimeMillis())
            .bufferPoolUsage(getBufferPoolUsage())
            .logBufferUsage(getLogBufferUsage())
            .dataDictCacheUsage(getDataDictCacheUsage())
            .freeMemory(getFreeMemory())
            .fragmentationRatio(calculateFragmentationRatio())
            .build();
    }
    
    // æ€§èƒ½æŒ‡æ ‡è®¡ç®—
    private PerformanceMetrics calculatePerformance(MemorySnapshot snapshot) {
        // è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡
        double hitRatio = (double)cacheHits / (cacheHits + cacheMisses);
        
        // è®¡ç®—å†…å­˜åˆ†é…æ•ˆç‡
        double allocEfficiency = (double)successfulAllocs / totalAllocs;
        
        // è®¡ç®—NUMAä¼˜åŒ–æ•ˆæœ
        double numaEfficiency = (double)localAccess / (localAccess + remoteAccess);
        
        return PerformanceMetrics.builder()
            .cacheHitRatio(hitRatio)
            .allocationEfficiency(allocEfficiency)
            .numaEfficiency(numaEfficiency)
            .build();
    }
}
```

### 9.3 å†…å­˜æ³„æ¼æ£€æµ‹


**ğŸ” æ³„æ¼æ£€æµ‹æœºåˆ¶**

```java
class MemoryLeakDetector {
    
    // å†…å­˜åˆ†é…è¿½è¸ª
    private Map<MemoryBlock, AllocationInfo> allocationTracker = new ConcurrentHashMap<>();
    
    // æ³„æ¼æ£€æµ‹é…ç½®
    private static final long LEAK_DETECTION_THRESHOLD = 60 * 60 * 1000; // 1å°æ—¶
    private static final int MAX_TRACKED_ALLOCATIONS = 100000;
    
    // è®°å½•å†…å­˜åˆ†é…
    public void recordAllocation(MemoryBlock block, String source) {
        if (allocationTracker.size() < MAX_TRACKED_ALLOCATIONS) {
            AllocationInfo info = new AllocationInfo(
                System.currentTimeMillis(),
                Thread.currentThread().getStackTrace(),
                source
            );
            allocationTracker.put(block, info);
        }
    }
    
    // è®°å½•å†…å­˜é‡Šæ”¾
    public void recordDeallocation(MemoryBlock block) {
        allocationTracker.remove(block);
    }
    
    // æ‰§è¡Œæ³„æ¼æ£€æµ‹
    public LeakDetectionReport detectLeaks() {
        long currentTime = System.currentTimeMillis();
        List<SuspiciousAllocation> suspiciousAllocations = new ArrayList<>();
        
        for (Map.Entry<MemoryBlock, AllocationInfo> entry : allocationTracker.entrySet()) {
            AllocationInfo info = entry.getValue();
            long allocationAge = currentTime - info.getAllocationTime();
            
            // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼
            if (allocationAge > LEAK_DETECTION_THRESHOLD) {
                suspiciousAllocations.add(new SuspiciousAllocation(
                    entry.getKey(),
                    info,
                    allocationAge
                ));
            }
        }
        
        // æŒ‰åˆ†é…æ—¶é—´æ’åºï¼Œæœ€è€çš„æ’åœ¨å‰é¢
        suspiciousAllocations.sort(Comparator.comparing(
            sa -> sa.getAllocationInfo().getAllocationTime()
        ));
        
        return new LeakDetectionReport(suspiciousAllocations);
    }
    
    // è‡ªåŠ¨æ¸…ç†å’ŒæŠ¥å‘Š
    public void performPeriodicCheck() {
        LeakDetectionReport report = detectLeaks();
        
        if (!report.getSuspiciousAllocations().isEmpty()) {
            // è®°å½•è­¦å‘Šæ—¥å¿—
            logger.warn("Detected {} potential memory leaks", 
                report.getSuspiciousAllocations().size());
            
            // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
            generateLeakReport(report);
            
            // å¯é€‰ï¼šè‡ªåŠ¨è§¦å‘GC
            if (report.getSuspiciousAllocations().size() > 1000) {
                System.gc();
            }
        }
    }
}
```

### 9.4 æ€§èƒ½è°ƒä¼˜å·¥å…·


**ğŸ› ï¸ è°ƒä¼˜å·¥å…·é›†**

```
å†…å­˜æ€§èƒ½è°ƒä¼˜å·¥å…·ç®±ï¼š

ğŸ”¸ å®æ—¶åˆ†æå·¥å…·ï¼š
   â€¢ å†…å­˜ä½¿ç”¨çƒ­å›¾
   â€¢ ç¼“å­˜å‘½ä¸­ç‡è¶‹åŠ¿
   â€¢ åˆ†é…/é‡Šæ”¾é¢‘ç‡åˆ†æ
   â€¢ NUMAè®¿é—®æ¨¡å¼åˆ†æ

ğŸ”¸ å†å²åˆ†æå·¥å…·ï¼š
   â€¢ å†…å­˜ä½¿ç”¨è¶‹åŠ¿å›¾
   â€¢ æ€§èƒ½åŸºçº¿å¯¹æ¯”
   â€¢ å¼‚å¸¸æ£€æµ‹å’Œå‘Šè­¦
   â€¢ å®¹é‡è§„åˆ’å»ºè®®

ğŸ”¸ è°ƒä¼˜å»ºè®®å¼•æ“ï¼š
   â€¢ åŸºäºå†å²æ•°æ®çš„æ™ºèƒ½å»ºè®®
   â€¢ å‚æ•°ä¼˜åŒ–æ¨è
   â€¢ æ¶æ„æ”¹è¿›å»ºè®®
   â€¢ ç¡¬ä»¶å‡çº§å»ºè®®
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ InnoDBå†…å­˜æ¶æ„ï¼šç¼“å†²æ± å ä¸»å¯¼åœ°ä½çš„åˆ†å±‚å†…å­˜ç®¡ç†
ğŸ”¸ å†…å­˜æ± è®¾è®¡ï¼šé¢„åˆ†é…+åˆ†å±‚ç®¡ç†ï¼Œæé«˜åˆ†é…æ•ˆç‡
ğŸ”¸ LRUä¼˜åŒ–ç®—æ³•ï¼šåˆ†æ®µLRUè§£å†³ç¼“å­˜æ±¡æŸ“å’Œé¡ºåºæ‰«æé—®é¢˜  
ğŸ”¸ å†…å­˜åˆ†é…ç­–ç•¥ï¼šä¼™ä¼´ç³»ç»Ÿ+å¯¹è±¡æ± ï¼Œé€‚åº”ä¸åŒå¤§å°éœ€æ±‚
ğŸ”¸ ç¢ç‰‡ç®¡ç†ï¼šæ£€æµ‹+æ•´ç†+é¢„é˜²ï¼Œä¿æŒå†…å­˜ä½¿ç”¨æ•ˆç‡
ğŸ”¸ NUMAä¼˜åŒ–ï¼šæœ¬åœ°åŒ–è®¿é—®ï¼Œå‡å°‘è·¨èŠ‚ç‚¹å†…å­˜è®¿é—®
ğŸ”¸ æ€§èƒ½ç›‘æ§ï¼šå®æ—¶æŒ‡æ ‡+å†å²åˆ†æ+è‡ªåŠ¨è°ƒä¼˜
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆInnoDBéœ€è¦å¤æ‚çš„å†…å­˜ç®¡ç†**
```
æ•°æ®åº“ç‰¹ç‚¹å†³å®šï¼š
â€¢ æ•°æ®è®¿é—®æ¨¡å¼å¤æ‚ï¼šéšæœºè¯»å†™æ··åˆ
â€¢ å¹¶å‘è¦æ±‚é«˜ï¼šå¤šçº¿ç¨‹åŒæ—¶è®¿é—®å†…å­˜
â€¢ å¯é æ€§è¦æ±‚ï¼šæ•°æ®ä¸èƒ½ä¸¢å¤±
â€¢ æ€§èƒ½è¦æ±‚ï¼šå†…å­˜è®¿é—®å¿…é¡»é«˜æ•ˆ

å¤æ‚ç®¡ç†çš„ä»·å€¼ï¼š
â€¢ ç¼“å†²æ± ï¼šå°†ç£ç›˜IOè½¬ä¸ºå†…å­˜è®¿é—®ï¼Œæ€§èƒ½æå‡100-1000å€
â€¢ LRUç®—æ³•ï¼šç¡®ä¿çƒ­ç‚¹æ•°æ®ç•™åœ¨å†…å­˜ä¸­
â€¢ é¢„åˆ†é…ï¼šå‡å°‘è¿è¡Œæ—¶çš„å†…å­˜ç®¡ç†å¼€é”€
â€¢ ç¢ç‰‡æ•´ç†ï¼šä¿æŒå†…å­˜ä½¿ç”¨æ•ˆç‡
```

**ğŸ”¹ å†…å­˜ç®¡ç†ç®—æ³•çš„é€‰æ‹©åŸåˆ™**
```
ä¸åŒåœºæ™¯çš„æœ€ä¼˜é€‰æ‹©ï¼š
â€¢ å¤§å—å†…å­˜ï¼šä¼™ä¼´ç³»ç»Ÿç®—æ³•ï¼Œå‡å°‘å¤–éƒ¨ç¢ç‰‡
â€¢ å°å¯¹è±¡ï¼šå¯¹è±¡æ± ç®¡ç†ï¼Œé¿å…é¢‘ç¹åˆ†é…é‡Šæ”¾
â€¢ ç¼“å­˜æ›¿æ¢ï¼šæ”¹è¿›ç‰ˆLRUï¼Œå…¼é¡¾æ€§èƒ½å’Œå‡†ç¡®æ€§
â€¢ å¹¶å‘è®¿é—®ï¼šåˆ†æ®µé”+CASï¼Œå‡å°‘é”ç«äº‰
```

**ğŸ”¹ NUMAæ¶æ„çš„å½±å“å’Œä¼˜åŒ–**
```
æ€§èƒ½å½±å“ï¼š
â€¢ æœ¬åœ°è®¿é—® vs è·¨NUMAè®¿é—®ï¼š30-50%æ€§èƒ½å·®å¼‚
â€¢ å†…å­˜å¸¦å®½ï¼šæœ¬åœ°>è·¨èŠ‚ç‚¹>è·¨æ’æ§½

ä¼˜åŒ–ç­–ç•¥ï¼š
â€¢ çº¿ç¨‹ç»‘å®šï¼šå·¥ä½œçº¿ç¨‹ç»‘å®šåˆ°ç‰¹å®šNUMAèŠ‚ç‚¹
â€¢ å†…å­˜æœ¬åœ°åŒ–ï¼šæ•°æ®å°½é‡åˆ†é…åœ¨å·¥ä½œçº¿ç¨‹çš„æœ¬åœ°å†…å­˜
â€¢ ç¼“å†²æ± åˆ†åŒºï¼šæ¯ä¸ªNUMAèŠ‚ç‚¹ç‹¬ç«‹çš„ç¼“å†²æ± 
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é…ç½®ä¼˜åŒ–å»ºè®®**

| åœºæ™¯ | **å†…å­˜é…ç½®ç­–ç•¥** | **å…³é”®å‚æ•°** | **æ³¨æ„äº‹é¡¹** |
|------|-----------------|-------------|-------------|
| **OLTPé«˜å¹¶å‘** | `ç¼“å†²æ± 75%ï¼Œå…¶ä½™25%` | `innodb_buffer_pool_size` | `é¿å…swapï¼Œé¢„ç•™OSå†…å­˜` |
| **OLAPåˆ†æ** | `ç¼“å†²æ± 85%ï¼Œå…¶ä½™15%` | `innodb_log_buffer_sizeå¢å¤§` | `å¤§æŸ¥è¯¢éœ€è¦æ›´å¤šæ—¥å¿—ç¼“å†²` |
| **æ··åˆè´Ÿè½½** | `ç¼“å†²æ± 80%ï¼Œå…¶ä½™20%` | `åˆ†å¤šä¸ªç¼“å†²æ± å®ä¾‹` | `å‡å°‘é”ç«äº‰` |

**ğŸ”§ è°ƒä¼˜æ£€æŸ¥æ¸…å•**

- [ ] **å†…å­˜é…ç½®åˆç†æ€§**ï¼šæ€»å†…å­˜çš„80%ç»™InnoDBæ˜¯å¦åˆé€‚
- [ ] **ç¼“å†²æ± å‘½ä¸­ç‡**ï¼šæ˜¯å¦>99%ï¼Œå¦‚æœä¸å¤Ÿéœ€è¦å¢åŠ å†…å­˜
- [ ] **å†…å­˜ç¢ç‰‡ç‡**ï¼šæ˜¯å¦<20%ï¼Œè¿‡é«˜éœ€è¦æ•´ç†
- [ ] **NUMAä¼˜åŒ–**ï¼šæ˜¯å¦å¯ç”¨NUMAæ„ŸçŸ¥çš„å†…å­˜åˆ†é…
- [ ] **ç›‘æ§å‘Šè­¦**ï¼šæ˜¯å¦å»ºç«‹å®Œå–„çš„å†…å­˜ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

### 10.4 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**â“ å¸¸è§é—®é¢˜è¯Šæ–­**

```
é—®é¢˜1ï¼šç¼“å†²æ± å‘½ä¸­ç‡ä½
ç—‡çŠ¶ï¼šå¤§é‡ç£ç›˜IOï¼ŒæŸ¥è¯¢å“åº”æ…¢
åŸå› ï¼šå†…å­˜ä¸è¶³æˆ–è®¿é—®æ¨¡å¼é—®é¢˜
è§£å†³ï¼šå¢åŠ å†…å­˜æˆ–ä¼˜åŒ–æŸ¥è¯¢

é—®é¢˜2ï¼šå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜
ç—‡çŠ¶ï¼šç³»ç»Ÿä½¿ç”¨swapï¼Œæ€§èƒ½ä¸‹é™
åŸå› ï¼šå†…å­˜é…ç½®è¿‡å¤§æˆ–å­˜åœ¨å†…å­˜æ³„æ¼
è§£å†³ï¼šè°ƒæ•´é…ç½®æˆ–æ£€æŸ¥æ³„æ¼

é—®é¢˜3ï¼šNUMAæ€§èƒ½é—®é¢˜
ç—‡çŠ¶ï¼šCPUä½¿ç”¨ä¸å‡è¡¡ï¼Œè·¨èŠ‚ç‚¹è®¿é—®å¤š
åŸå› ï¼šæ²¡æœ‰NUMAä¼˜åŒ–é…ç½®
è§£å†³ï¼šå¯ç”¨NUMAæ„ŸçŸ¥ï¼Œçº¿ç¨‹ç»‘å®š

é—®é¢˜4ï¼šå†…å­˜ç¢ç‰‡ä¸¥é‡
ç—‡çŠ¶ï¼šåˆ†é…å¤±è´¥ç‡é«˜ï¼Œå†…å­˜åˆ©ç”¨ç‡ä½
åŸå› ï¼šé•¿æ—¶é—´è¿è¡Œï¼Œå†…å­˜ç¢ç‰‡ç§¯ç´¯
è§£å†³ï¼šå®šæœŸé‡å¯æˆ–åœ¨çº¿ç¢ç‰‡æ•´ç†
```

### 10.5 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸ“š æ·±å…¥å­¦ä¹ å»ºè®®**

```
ç†è®ºåŸºç¡€åŠ å¼ºï¼š
ğŸ”¸ æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åŸç†
ğŸ”¸ CPUç¼“å­˜ä½“ç³»ç»“æ„
ğŸ”¸ NUMAæ¶æ„æ·±å…¥ç†è§£
ğŸ”¸ å¹¶å‘ç¼–ç¨‹å’Œé”æœºåˆ¶

å®è·µæŠ€èƒ½æå‡ï¼š
ğŸ”¸ æ€§èƒ½è°ƒä¼˜å®æˆ˜ç»éªŒ
ğŸ”¸ ç›‘æ§å’Œæ•…éšœè¯Šæ–­
ğŸ”¸ å¤§è§„æ¨¡ç³»ç»Ÿæ¶æ„è®¾è®¡
ğŸ”¸ ç¡¬ä»¶æ€§èƒ½ä¼˜åŒ–

å·¥å…·æŒæ¡ï¼š
ğŸ”¸ å†…å­˜åˆ†æå·¥å…·ä½¿ç”¨
ğŸ”¸ æ€§èƒ½æµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•
ğŸ”¸ ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦é…ç½®
ğŸ”¸ è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ç¼–å†™
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
- **å†…å­˜ç®¡ç†æ˜¯æ€§èƒ½å…³é”®**ï¼šå¥½çš„å†…å­˜ç®¡ç†èƒ½è®©æ•°æ®åº“æ€§èƒ½æå‡10å€ä»¥ä¸Š
- **åˆ†å±‚è®¾è®¡æ˜¯æ ¸å¿ƒ**ï¼šä¸åŒç±»å‹çš„å†…å­˜éœ€æ±‚ç”¨ä¸åŒçš„ç®¡ç†ç­–ç•¥
- **ç®—æ³•é€‰æ‹©å¾ˆé‡è¦**ï¼šåˆé€‚çš„ç®—æ³•èƒ½å¤§å¹…æå‡æ•ˆç‡å’Œå‡å°‘ç¢ç‰‡
- **NUMAä¸å¯å¿½è§†**ï¼šç°ä»£æœåŠ¡å™¨NUMAæ¶æ„å¯¹æ€§èƒ½å½±å“å·¨å¤§
- **ç›‘æ§æ˜¯åŸºç¡€**ï¼šæ²¡æœ‰ç›‘æ§å°±æ²¡æœ‰ä¼˜åŒ–çš„ä¾æ®

**ğŸ§  è®°å¿†å£è¯€**
> ç¼“å†²æ± é‡Œè—çƒ­ç‚¹ï¼ŒLRUç®—æ³•æŠŠé—¨å®ˆ  
> ä¼™ä¼´ç³»ç»Ÿåˆ†å¤§å—ï¼Œå¯¹è±¡æ± é‡Œæ”¾å°ä»¶  
> NUMAä¼˜åŒ–è¦æœ¬åœ°ï¼Œç¢ç‰‡æ•´ç†ä¿æ•ˆç‡  
> ç›‘æ§å‘Šè­¦ä¸èƒ½å°‘ï¼Œè°ƒä¼˜è·¯ä¸Šæ‰èƒ½å¥½