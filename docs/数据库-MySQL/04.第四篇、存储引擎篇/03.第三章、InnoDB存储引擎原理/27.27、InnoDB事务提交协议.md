---
title: 27ã€InnoDBäº‹åŠ¡æäº¤åè®®
---
## ðŸ“š ç›®å½•

1. [äº‹åŠ¡æäº¤åè®®æ¦‚è¿°](#1-äº‹åŠ¡æäº¤åè®®æ¦‚è¿°)
2. [ä¸¤é˜¶æ®µæäº¤2PCåè®®](#2-ä¸¤é˜¶æ®µæäº¤2PCåè®®)
3. [binlogä¸Žredo logåè°ƒæœºåˆ¶](#3-binlogä¸Žredo-logåè°ƒæœºåˆ¶)
4. [äº‹åŠ¡æäº¤ä¼˜åŒ–æŠ€æœ¯](#4-äº‹åŠ¡æäº¤ä¼˜åŒ–æŠ€æœ¯)
5. [æäº¤å¤±è´¥å¤„ç†æœºåˆ¶](#5-æäº¤å¤±è´¥å¤„ç†æœºåˆ¶)
6. [åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§](#6-åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ äº‹åŠ¡æäº¤åè®®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡æäº¤åè®®


**é€šä¿—ç†è§£**ï¼šäº‹åŠ¡æäº¤åè®®å°±åƒé“¶è¡Œè½¬è´¦çš„ç¡®è®¤æµç¨‹ï¼Œç¡®ä¿é’±è¦ä¹ˆå®Œå…¨è½¬æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨æ²¡è½¬ï¼Œä¸ä¼šå‡ºçŽ°è½¬äº†ä¸€åŠçš„æƒ…å†µã€‚

```
æ™®é€šæ“ä½œ vs äº‹åŠ¡æ“ä½œï¼š

æ™®é€šæ–‡ä»¶ä¿å­˜ï¼š
å†™å…¥æ•°æ® â†’ ä¿å­˜ â†’ å®Œæˆ
ï¼ˆå¯èƒ½å‡ºçŽ°ä¿å­˜ä¸€åŠæ–­ç”µçš„æƒ…å†µï¼‰

äº‹åŠ¡æäº¤ï¼š
å‡†å¤‡é˜¶æ®µ â†’ ç¡®è®¤é˜¶æ®µ â†’ æäº¤å®Œæˆ
ï¼ˆè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›žæ»šï¼‰
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æäº¤åè®®


**æ ¸å¿ƒé—®é¢˜**ï¼šInnoDBæœ‰å¤šä¸ªæ—¥å¿—ç³»ç»Ÿéœ€è¦åè°ƒ

```
InnoDBçš„å¤šæ—¥å¿—ç³»ç»Ÿï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ redo log    â”‚    â”‚ binlog       â”‚
â”‚ (å¼•æ“Žå±‚)    â”‚    â”‚ (æœåŠ¡å™¨å±‚)   â”‚
â”‚ ä¿è¯æŒä¹…æ€§   â”‚    â”‚ ä¸»ä»Žå¤åˆ¶     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                 â†“
    å¿…é¡»ä¿æŒä¸€è‡´ï¼ä¸èƒ½ä¸€ä¸ªå†™äº†ï¼Œå¦ä¸€ä¸ªæ²¡å†™
```

**ä¸€è‡´æ€§æŒ‘æˆ˜**ï¼š
- **redo log**å†™äº†ï¼Œ**binlog**æ²¡å†™ â†’ ä¸»ä»Žæ•°æ®ä¸ä¸€è‡´
- **binlog**å†™äº†ï¼Œ**redo log**æ²¡å†™ â†’ æ•°æ®æ¢å¤æ—¶ä¸¢å¤±
- **éƒ¨åˆ†å†™å…¥** â†’ äº‹åŠ¡çŠ¶æ€ä¸æ˜Žç¡®

### 1.3 ðŸ”¸ æäº¤åè®®çš„ACIDä¿è¯


**ACIDåœ¨æäº¤åè®®ä¸­çš„ä½“çŽ°**ï¼š
- **A(åŽŸå­æ€§)** - è¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›žæ»š
- **C(ä¸€è‡´æ€§)** - binlogå’Œredo logä¿æŒä¸€è‡´
- **I(éš”ç¦»æ€§)** - æäº¤è¿‡ç¨‹å¯¹å…¶ä»–äº‹åŠ¡é€æ˜Ž
- **D(æŒä¹…æ€§)** - æäº¤åŽæ•°æ®æ°¸ä¹…ä¿å­˜

---

## 2. ðŸ”„ ä¸¤é˜¶æ®µæäº¤2PCåè®®


### 2.1 ðŸ”¥ ä¸¤é˜¶æ®µæäº¤åè®®åŽŸç†


**ç®€å•æ¯”å–»**ï¼šä¸¤é˜¶æ®µæäº¤å°±åƒç»“å©šå…¸ç¤¼ï¼Œéœ€è¦ä¸¤ä¸ªå…³é”®æ­¥éª¤éƒ½æˆåŠŸæ‰ç®—å®Œæˆã€‚

```
ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µï¼ˆPrepareï¼‰
å°±åƒç»“å©šç™»è®°å‰çš„å‡†å¤‡ï¼š
- æ£€æŸ¥è¯ä»¶æ˜¯å¦é½å…¨
- ç¡®è®¤åŒæ–¹éƒ½åŒæ„
- å‡†å¤‡æ‰€æœ‰å¿…è¦ææ–™

ç¬¬äºŒé˜¶æ®µï¼šæäº¤é˜¶æ®µï¼ˆCommitï¼‰
å°±åƒæ­£å¼é¢†è¯ï¼š
- ç­¾å­—ç›–ç« 
- æ­£å¼ç”Ÿæ•ˆ
- ä¸å¯æ’¤é”€
```

### 2.2 InnoDBä¸­çš„2PCå®žçŽ°


**åè°ƒè€…ä¸Žå‚ä¸Žè€…**ï¼š
```
åè°ƒè€…ï¼šMySQLæœåŠ¡å™¨å±‚
å‚ä¸Žè€…ï¼šInnoDBå­˜å‚¨å¼•æ“Ž

                MySQLæœåŠ¡å™¨å±‚(åè°ƒè€…)
                        |
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                â†“               â†“
         InnoDBå¼•æ“Ž        binlogç³»ç»Ÿ
         (å‚ä¸Žè€…1)         (å‚ä¸Žè€…2)
```

### 2.3 ðŸ”¥ ä¸¤é˜¶æ®µæäº¤è¯¦ç»†æµç¨‹


**é˜¶æ®µä¸€ï¼šPrepareå‡†å¤‡é˜¶æ®µ**
```
â‘  äº‹åŠ¡æ‰§è¡Œå®Œæ‰€æœ‰SQLæ“ä½œ
â‘¡ InnoDBå°†redo logå†™å…¥æ—¥å¿—ç¼“å†²åŒº
â‘¢ InnoDBè¿›å…¥PREPAREçŠ¶æ€
â‘£ é€šçŸ¥åè°ƒè€…å‡†å¤‡å®Œæˆ

æ­¤æ—¶çŠ¶æ€ï¼š
- redo logï¼šå·²å†™å…¥ï¼Œæ ‡è®°ä¸ºPREPARE
- binlogï¼šå°šæœªå†™å…¥
- äº‹åŠ¡ï¼šå‡†å¤‡çŠ¶æ€ï¼Œæœªæäº¤
```

**é˜¶æ®µäºŒï¼šCommitæäº¤é˜¶æ®µ**
```
â‘¤ åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…çš„PREPAREç¡®è®¤
â‘¥ åè°ƒè€…å†™å…¥binlog
â‘¦ åè°ƒè€…å‘é€COMMITæŒ‡ä»¤ç»™InnoDB
â‘§ InnoDBå°†redo logçŠ¶æ€æ”¹ä¸ºCOMMIT
â‘¨ äº‹åŠ¡æ­£å¼æäº¤å®Œæˆ

æœ€ç»ˆçŠ¶æ€ï¼š
- redo logï¼šå·²å†™å…¥ï¼Œæ ‡è®°ä¸ºCOMMIT
- binlogï¼šå·²å†™å…¥ï¼ŒåŒ…å«å®Œæ•´äº‹åŠ¡ä¿¡æ¯
- äº‹åŠ¡ï¼šæäº¤å®Œæˆï¼Œæ•°æ®æŒä¹…åŒ–
```

### 2.4 2PCæ—¶åºå›¾


```
å®¢æˆ·ç«¯        MySQLæœåŠ¡å™¨      InnoDBå¼•æ“Ž       binlog
  |              |              |               |
  |--COMMIT----->|              |               |
  |              |--prepare---->|               |
  |              |              |--å†™redo log-->|
  |              |              |--æ ‡è®°PREPARE->|
  |              |<--å‡†å¤‡å®Œæˆ----|               |
  |              |              |               |
  |              |--å†™binlog----|-------------->|
  |              |              |               |--å†™å…¥ç£ç›˜
  |              |--commit----->|               |
  |              |              |--æ ‡è®°COMMIT-->|
  |              |<--æäº¤å®Œæˆ----|               |
  |<--äº‹åŠ¡æˆåŠŸ----|              |               |
```

---

## 3. ðŸ”— binlogä¸Žredo logåè°ƒæœºåˆ¶


### 3.1 ðŸ”¥ ä¸¤ç§æ—¥å¿—çš„è§’è‰²å·®å¼‚


**redo log(é‡åšæ—¥å¿—)**ï¼š
- **å½’å±ž**ï¼šInnoDBå­˜å‚¨å¼•æ“Žä¸“æœ‰
- **ä½œç”¨**ï¼šä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§å’Œå´©æºƒæ¢å¤
- **ç‰¹ç‚¹**ï¼šå¾ªçŽ¯å†™å…¥ï¼Œç©ºé—´å›ºå®š
- **è®°å½•å†…å®¹**ï¼šç‰©ç†æ—¥å¿—ï¼Œè®°å½•æ•°æ®é¡µçš„å…·ä½“å˜åŒ–

**binlog(äºŒè¿›åˆ¶æ—¥å¿—)**ï¼š
- **å½’å±ž**ï¼šMySQLæœåŠ¡å™¨å±‚ï¼Œæ‰€æœ‰å¼•æ“Žå…±ç”¨
- **ä½œç”¨**ï¼šä¸»ä»Žå¤åˆ¶å’Œæ•°æ®æ¢å¤
- **ç‰¹ç‚¹**ï¼šè¿½åŠ å†™å…¥ï¼Œå¯è®¾ç½®å¤§å°å’Œæ•°é‡
- **è®°å½•å†…å®¹**ï¼šé€»è¾‘æ—¥å¿—ï¼Œè®°å½•SQLè¯­å¥æˆ–è¡Œå˜åŒ–

### 3.2 ðŸ”¥ åè°ƒæœºåˆ¶çš„è®¾è®¡åŽŸç†


**ä¸ºä»€ä¹ˆéœ€è¦åè°ƒ**ï¼š
```
å•ç‹¬å†™å…¥çš„é—®é¢˜ï¼š

æƒ…å†µ1ï¼šåªå†™redo logï¼Œä¸å†™binlog
åŽæžœï¼šä¸»åº“æ¢å¤æ­£å¸¸ï¼Œä½†ä»Žåº“æ²¡æœ‰è¿™ä¸ªäº‹åŠ¡ â†’ ä¸»ä»Žä¸ä¸€è‡´

æƒ…å†µ2ï¼šåªå†™binlogï¼Œä¸å†™redo log  
åŽæžœï¼šä»Žåº“æœ‰è¿™ä¸ªäº‹åŠ¡ï¼Œä½†ä¸»åº“å´©æºƒåŽä¸¢å¤± â†’ ä¸»ä»Žä¸ä¸€è‡´

æƒ…å†µ3ï¼šå…ˆå†™redo logï¼Œå†å†™binlogï¼ˆæ— åè°ƒï¼‰
åŽæžœï¼šredo logå†™æˆåŠŸï¼Œbinlogå†™å¤±è´¥ â†’ æ•°æ®ä¸ä¸€è‡´
```

### 3.3 åè°ƒæœºåˆ¶å®žçŽ°ç»†èŠ‚


**å†™å…¥é¡ºåºä¿è¯**ï¼š
```
æ­¥éª¤1ï¼šInnoDB prepareé˜¶æ®µ
- å°†redo logå†™å…¥log buffer
- åˆ·æ–°åˆ°ç£ç›˜ï¼ˆå¯é€‰ï¼Œçœ‹é…ç½®ï¼‰
- äº‹åŠ¡çŠ¶æ€æ ‡è®°ä¸ºPREPARE

æ­¥éª¤2ï¼šå†™å…¥binlog
- ç”Ÿæˆbinlogäº‹ä»¶
- å†™å…¥binlogç¼“å­˜
- åˆ·æ–°binlogåˆ°ç£ç›˜

æ­¥éª¤3ï¼šInnoDB commité˜¶æ®µ
- å°†redo logçŠ¶æ€æ”¹ä¸ºCOMMIT
- é‡Šæ”¾é”èµ„æº
- äº‹åŠ¡æ­£å¼å®Œæˆ
```

### 3.4 ðŸ”¥ äº‹åŠ¡æäº¤é¡ºåºä¿è¯


**é¡ºåºä¸€è‡´æ€§è¦æ±‚**ï¼šbinlogä¸­äº‹åŠ¡çš„é¡ºåºå¿…é¡»å’Œå®žé™…æäº¤é¡ºåºä¸€è‡´

**å®žçŽ°æœºåˆ¶**ï¼š
```
æäº¤é¡ºåºåè°ƒå™¨ï¼š

äº‹åŠ¡A: [Prepare] â†’ [ç­‰å¾…] â†’ [å†™binlog] â†’ [Commit]
äº‹åŠ¡B: [Prepare] â†’ [ç­‰å¾…] â†’ [å†™binlog] â†’ [Commit]  
äº‹åŠ¡C: [Prepare] â†’ [ç­‰å¾…] â†’ [å†™binlog] â†’ [Commit]

ä¿è¯æœºåˆ¶ï¼š
â‘ åºåˆ—åŒ–å†™binlogï¼šåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡å†™binlog
â‘¡æäº¤åºå·ï¼šä¸ºæ¯ä¸ªäº‹åŠ¡åˆ†é…é€’å¢žçš„æäº¤åºå·
â‘¢ç­‰å¾…æœºåˆ¶ï¼šåŽæäº¤çš„äº‹åŠ¡ç­‰å¾…å‰é¢çš„äº‹åŠ¡å®Œæˆ
```

---

## 4. âš¡ äº‹åŠ¡æäº¤ä¼˜åŒ–æŠ€æœ¯


### 4.1 ðŸ”¥ group commitä¼˜åŒ–ç®—æ³•


**é—®é¢˜èƒŒæ™¯**ï¼šæ¯ä¸ªäº‹åŠ¡éƒ½å•ç‹¬åˆ·ç›˜ä¼šå¯¼è‡´å¤§é‡ç£ç›˜I/O

**Group CommitåŽŸç†**ï¼š
```
ä¼ ç»Ÿæäº¤æ–¹å¼ï¼š
äº‹åŠ¡Aæäº¤ â†’ åˆ·ç›˜ â†’ ç­‰å¾…ç£ç›˜å®Œæˆ â†’ äº‹åŠ¡Aå®Œæˆ
äº‹åŠ¡Bæäº¤ â†’ åˆ·ç›˜ â†’ ç­‰å¾…ç£ç›˜å®Œæˆ â†’ äº‹åŠ¡Bå®Œæˆ
äº‹åŠ¡Cæäº¤ â†’ åˆ·ç›˜ â†’ ç­‰å¾…ç£ç›˜å®Œæˆ â†’ äº‹åŠ¡Cå®Œæˆ
ç£ç›˜æ“ä½œï¼š3æ¬¡

Group Commitæ–¹å¼ï¼š
äº‹åŠ¡Aã€Bã€CåŒæ—¶å‡†å¤‡å¥½ â†’ ä¸€æ¬¡æ€§åˆ·ç›˜ â†’ ä¸‰ä¸ªäº‹åŠ¡åŒæ—¶å®Œæˆ
ç£ç›˜æ“ä½œï¼š1æ¬¡
```

**å®žçŽ°æœºåˆ¶**ï¼š
```
ç»„æäº¤é˜Ÿåˆ—ï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚äº‹åŠ¡Aâ”‚äº‹åŠ¡Bâ”‚äº‹åŠ¡Câ”‚äº‹åŠ¡Dâ”‚ â† ç­‰å¾…æäº¤çš„äº‹åŠ¡é˜Ÿåˆ—
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
           |
           â†“
    æ‰¹é‡å†™å…¥ç£ç›˜
           â†“
     åŒæ—¶æ ‡è®°å®Œæˆ
```

### 4.2 Group Commitçš„ä¸‰ä¸ªé˜¶æ®µ


**é˜¶æ®µåˆ’åˆ†**ï¼š
```
Flushé˜¶æ®µï¼šå‡†å¤‡redo log
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚äº‹åŠ¡1 äº‹åŠ¡2 äº‹åŠ¡3 ... äº‹åŠ¡N  â”‚ â† æ”¶é›†å‡†å¤‡å¥½çš„äº‹åŠ¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        æ‰¹é‡åˆ·æ–°redo log

Syncé˜¶æ®µï¼šå†™å…¥binlog  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚äº‹åŠ¡1 äº‹åŠ¡2 äº‹åŠ¡3 ... äº‹åŠ¡N  â”‚ â† æŒ‰é¡ºåºå†™binlog
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        æ‰¹é‡åˆ·æ–°binlog

Commité˜¶æ®µï¼šæœ€ç»ˆæäº¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚äº‹åŠ¡1 äº‹åŠ¡2 äº‹åŠ¡3 ... äº‹åŠ¡N  â”‚ â† æ‰¹é‡æäº¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        åŒæ—¶æ ‡è®°COMMIT
```

### 4.3 ðŸ”¥ å¼‚æ­¥æäº¤æœºåˆ¶


**åŒæ­¥ vs å¼‚æ­¥æäº¤**ï¼š
```
åŒæ­¥æäº¤ï¼š
äº‹åŠ¡æäº¤ â†’ ç­‰å¾…ç£ç›˜å†™å…¥å®Œæˆ â†’ è¿”å›žæˆåŠŸ
ä¼˜ç‚¹ï¼šæ•°æ®å®‰å…¨æ€§æœ€é«˜
ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒä½Žï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿

å¼‚æ­¥æäº¤ï¼š  
äº‹åŠ¡æäº¤ â†’ ç«‹å³è¿”å›žæˆåŠŸ â†’ åŽå°å†™å…¥ç£ç›˜
ä¼˜ç‚¹ï¼šå“åº”é€Ÿåº¦å¿«ï¼Œç”¨æˆ·ä½“éªŒå¥½
ç¼ºç‚¹ï¼šå­˜åœ¨æ•°æ®ä¸¢å¤±é£Žé™©
```

**é…ç½®å‚æ•°**ï¼š
```sql
-- æŽ§åˆ¶redo logåˆ·ç›˜ç­–ç•¥
SET GLOBAL innodb_flush_log_at_trx_commit = 1;  -- åŒæ­¥åˆ·ç›˜ï¼ˆæœ€å®‰å…¨ï¼‰
SET GLOBAL innodb_flush_log_at_trx_commit = 0;  -- æ¯ç§’åˆ·ç›˜ï¼ˆæ€§èƒ½æœ€å¥½ï¼‰
SET GLOBAL innodb_flush_log_at_trx_commit = 2;  -- å†™OSç¼“å­˜ï¼ˆå¹³è¡¡ï¼‰

-- æŽ§åˆ¶binlogåˆ·ç›˜ç­–ç•¥  
SET GLOBAL sync_binlog = 1;    -- æ¯æ¬¡äº‹åŠ¡éƒ½åˆ·ç›˜
SET GLOBAL sync_binlog = 0;    -- ä¾èµ–OSåˆ·ç›˜
SET GLOBAL sync_binlog = 100;  -- æ¯100ä¸ªäº‹åŠ¡åˆ·ç›˜ä¸€æ¬¡
```

---

## 5. âŒ æäº¤å¤±è´¥å¤„ç†æœºåˆ¶


### 5.1 ðŸ”¥ æäº¤å¤±è´¥çš„å…¸åž‹åœºæ™¯


**å¸¸è§å¤±è´¥åŽŸå› **ï¼š
- **ç£ç›˜ç©ºé—´ä¸è¶³** - æ— æ³•å†™å…¥æ—¥å¿—æ–‡ä»¶
- **ç£ç›˜ç¡¬ä»¶æ•…éšœ** - I/Oé”™è¯¯
- **ç³»ç»Ÿå´©æºƒ** - è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢
- **ç½‘ç»œä¸­æ–­** - åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹çš„ç½‘ç»œé—®é¢˜

### 5.2 å„é˜¶æ®µå¤±è´¥å¤„ç†


**Prepareé˜¶æ®µå¤±è´¥**ï¼š
```
å¤±è´¥ç‚¹ï¼šredo logå†™å…¥å¤±è´¥
å¤„ç†ï¼š
â‘ ç«‹å³å›žæ»šäº‹åŠ¡
â‘¡é‡Šæ”¾æ‰€æœ‰é”èµ„æº
â‘¢å‘å®¢æˆ·ç«¯è¿”å›žé”™è¯¯ä¿¡æ¯
â‘£ä¸å†™å…¥binlog

ç»“æžœï¼šäº‹åŠ¡å®Œå…¨å–æ¶ˆï¼Œæ•°æ®ä¿æŒä¸€è‡´
```

**binlogå†™å…¥é˜¶æ®µå¤±è´¥**ï¼š
```
å¤±è´¥ç‚¹ï¼šbinlogå†™å…¥å¤±è´¥ï¼Œä½†redo logå·²å†™å…¥
å¤„ç†ï¼š
â‘ å›žæ»šInnoDBäº‹åŠ¡
â‘¡æ¸…ç†redo logä¸­çš„PREPAREè®°å½•
â‘¢å‘å®¢æˆ·ç«¯è¿”å›žå¤±è´¥

é—®é¢˜ï¼šè¿™ç§æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ä»”ç»†æ¸…ç†
```

**Commité˜¶æ®µå¤±è´¥**ï¼š
```
å¤±è´¥ç‚¹ï¼šæœ€ç»ˆcommitæ ‡è®°å¤±è´¥
å¤„ç†ï¼š
â‘ redo logå’Œbinlogéƒ½å·²å†™å…¥
â‘¡æ•°æ®å®žé™…å·²ç»æŒä¹…åŒ–
â‘¢é‡è¯•commitæ ‡è®°
â‘£å¦‚æžœé‡è¯•å¤±è´¥ï¼Œåœ¨æ¢å¤æ—¶å¤„ç†

æ¢å¤ç­–ç•¥ï¼šæ ¹æ®binlogæ£€æŸ¥äº‹åŠ¡æ˜¯å¦åº”è¯¥æäº¤
```

### 5.3 å´©æºƒæ¢å¤æ—¶çš„å¤„ç†


**æ¢å¤åˆ¤æ–­é€»è¾‘**ï¼š
```
å¯åŠ¨æ—¶æ£€æŸ¥redo logçŠ¶æ€ï¼š

PREPAREçŠ¶æ€çš„äº‹åŠ¡ï¼š
â‘ æ£€æŸ¥å¯¹åº”çš„binlogæ˜¯å¦å­˜åœ¨
â‘¡å¦‚æžœbinlogå®Œæ•´ â†’ æäº¤äº‹åŠ¡
â‘¢å¦‚æžœbinlogä¸å­˜åœ¨/ä¸å®Œæ•´ â†’ å›žæ»šäº‹åŠ¡

COMMITçŠ¶æ€çš„äº‹åŠ¡ï¼š
â‘ ç¡®è®¤äº‹åŠ¡å·²æ­£å¸¸æäº¤
â‘¡æ— éœ€é¢å¤–å¤„ç†

æœªæ ‡è®°çŠ¶æ€çš„äº‹åŠ¡ï¼š
â‘ è®¤ä¸ºæ˜¯æœªå®Œæˆçš„äº‹åŠ¡
â‘¡æ‰§è¡Œå›žæ»šæ“ä½œ
```

---

## 6. ðŸŒ åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§


### 6.1 ðŸ”¸ åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§å®žçŽ°


**åˆ†å¸ƒå¼åœºæ™¯**ï¼šä¸»ä»Žå¤åˆ¶çŽ¯å¢ƒä¸‹çš„ä¸€è‡´æ€§ä¿è¯

```
ä¸»ä»Žå¤åˆ¶æž¶æž„ï¼š
   ä¸»åº“(Master)          ä»Žåº“(Slave1)         ä»Žåº“(Slave2)
        |                     |                    |
   â‘ äº‹åŠ¡æäº¤                â‘¡è¯»å–binlog          â‘¢è¯»å–binlog
        |                     |                    |
   â‘¢å†™å…¥binlog              â‘£æ‰§è¡ŒSQLè¯­å¥         â‘¤æ‰§è¡ŒSQLè¯­å¥
        |                     |                    |
   â‘£å¤åˆ¶å®Œæˆç¡®è®¤            â‘¤æ•°æ®åŒæ­¥å®Œæˆ        â‘¥æ•°æ®åŒæ­¥å®Œæˆ
```

### 6.2 åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®


**åŠåŒæ­¥å¤åˆ¶(Semi-Synchronous Replication)**ï¼š
```
æäº¤æµç¨‹ï¼š
â‘ ä¸»åº“æ‰§è¡Œäº‹åŠ¡
â‘¡ä¸»åº“å†™å…¥binlog
â‘¢ç­‰å¾…è‡³å°‘ä¸€ä¸ªä»Žåº“ç¡®è®¤æ”¶åˆ°binlog
â‘£ä¸»åº“æ ‡è®°äº‹åŠ¡æäº¤å®Œæˆ
â‘¤å‘å®¢æˆ·ç«¯è¿”å›žæˆåŠŸ

ä¼˜ç‚¹ï¼šä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªä»Žåº“æœ‰å®Œæ•´æ•°æ®
ç¼ºç‚¹ï¼šæ€§èƒ½ç•¥æœ‰ä¸‹é™ï¼Œéœ€è¦ç­‰å¾…ç½‘ç»œé€šä¿¡
```

**ç»„å¤åˆ¶(Group Replication)**ï¼š
```
å¤šä¸»åè°ƒæäº¤ï¼š
â‘ äº‹åŠ¡åœ¨æ‰€æœ‰èŠ‚ç‚¹å‡†å¤‡
â‘¡æ‰€æœ‰èŠ‚ç‚¹æŠ•ç¥¨å†³å®šæ˜¯å¦æäº¤
â‘¢å¤šæ•°åŒæ„åŽï¼Œæ‰€æœ‰èŠ‚ç‚¹æäº¤
â‘£ä¿è¯é›†ç¾¤æ•°æ®å¼ºä¸€è‡´æ€§

é€‚ç”¨ï¼šå¯¹ä¸€è‡´æ€§è¦æ±‚æžé«˜çš„ä¸šåŠ¡åœºæ™¯
```

---

## 7. ðŸ“Š æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ ä¸¤é˜¶æ®µæäº¤ï¼šä¿è¯å¤šä¸ªæ—¥å¿—ç³»ç»Ÿçš„ä¸€è‡´æ€§
ðŸ”¸ åè°ƒæœºåˆ¶ï¼šbinlogä¸Žredo logçš„å†™å…¥åè°ƒ
ðŸ”¸ æäº¤é¡ºåºï¼šä¿è¯äº‹åŠ¡æäº¤çš„é¡ºåºä¸€è‡´æ€§
ðŸ”¸ å¤±è´¥å¤„ç†ï¼šå„é˜¶æ®µå¤±è´¥çš„æ¢å¤ç­–ç•¥
ðŸ”¸ Group Commitï¼šæ‰¹é‡æäº¤ä¼˜åŒ–æ€§èƒ½
ðŸ”¸ å¼‚æ­¥æœºåˆ¶ï¼šå¹³è¡¡æ€§èƒ½ä¸Žå®‰å…¨æ€§
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤**
```
æ ¸å¿ƒé—®é¢˜ï¼šå¤šä¸ªç‹¬ç«‹ç³»ç»Ÿéœ€è¦åè°ƒ
è§£å†³æ–¹æ¡ˆï¼šåˆ†é˜¶æ®µç¡®è®¤ï¼Œä¿è¯åŽŸå­æ€§
å®žé™…æ•ˆæžœï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥
```

**ðŸ”¹ æäº¤åè®®å¦‚ä½•ä¿è¯ACID**
```
åŽŸå­æ€§ï¼šé€šè¿‡ä¸¤é˜¶æ®µç¡®è®¤ä¿è¯å…¨éƒ¨å®Œæˆæˆ–å…¨éƒ¨å›žæ»š
ä¸€è‡´æ€§ï¼šbinlogå’Œredo logå†…å®¹ä¿æŒä¸€è‡´
éš”ç¦»æ€§ï¼šæäº¤è¿‡ç¨‹åŠ é”ï¼Œå¯¹å…¶ä»–äº‹åŠ¡é€æ˜Ž
æŒä¹…æ€§ï¼šå†™å…¥ç£ç›˜åŽæ•°æ®æ°¸ä¸ä¸¢å¤±
```

**ðŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡**
```
å®‰å…¨æ€§ vs æ€§èƒ½ï¼š
- åŒæ­¥åˆ·ç›˜ï¼šæœ€å®‰å…¨ï¼Œæ€§èƒ½è¾ƒä½Ž
- å¼‚æ­¥åˆ·ç›˜ï¼šæ€§èƒ½æœ€å¥½ï¼Œå­˜åœ¨ä¸¢å¤±é£Žé™©
- Group Commitï¼šæ—¢ä¿è¯å®‰å…¨ï¼Œåˆæå‡æ€§èƒ½

é€‰æ‹©ç­–ç•¥ï¼šæ ¹æ®ä¸šåŠ¡å¯¹æ•°æ®å®‰å…¨æ€§çš„è¦æ±‚å†³å®š
```

### 7.3 å®žé™…åº”ç”¨ä»·å€¼


**è¿ç»´ç›‘æŽ§é‡ç‚¹**ï¼š
- **æäº¤å»¶è¿Ÿç›‘æŽ§** - å…³æ³¨äº‹åŠ¡æäº¤è€—æ—¶
- **å¤±è´¥çŽ‡ç»Ÿè®¡** - ç›‘æŽ§å„é˜¶æ®µçš„å¤±è´¥æƒ…å†µ  
- **Groupå¤§å°è°ƒä¼˜** - å¹³è¡¡æ‰¹å¤„ç†æ•ˆçŽ‡å’Œå»¶è¿Ÿ
- **ç£ç›˜I/Oä¼˜åŒ–** - åˆç†é…ç½®åˆ·ç›˜ç­–ç•¥

**æ€§èƒ½è°ƒä¼˜æ–¹å‘**ï¼š
```
é«˜å®‰å…¨æ€§è¦æ±‚ï¼š
innodb_flush_log_at_trx_commit = 1
sync_binlog = 1
ï¼ˆæ¯æ¬¡äº‹åŠ¡éƒ½åˆ·ç›˜ï¼Œæœ€å®‰å…¨ä½†æ€§èƒ½è¾ƒä½Žï¼‰

é«˜æ€§èƒ½è¦æ±‚ï¼š
innodb_flush_log_at_trx_commit = 2  
sync_binlog = 100
ï¼ˆé€‚å½“å»¶è¿Ÿåˆ·ç›˜ï¼Œæ€§èƒ½æå‡æ˜Žæ˜¾ï¼‰

å¹³è¡¡é…ç½®ï¼š
innodb_flush_log_at_trx_commit = 1
sync_binlog = 1
å¼€å¯Group Commit
ï¼ˆä¿è¯å®‰å…¨æ€§çš„åŒæ—¶ä¼˜åŒ–æ€§èƒ½ï¼‰
```

**æ•…éšœæŽ’æŸ¥è¦ç‚¹**ï¼š
- **æ£€æŸ¥æ—¥å¿—ä¸€è‡´æ€§** - å¯¹æ¯”redo logå’Œbinlogçš„äº‹åŠ¡è®°å½•
- **åˆ†æžæäº¤å»¶è¿Ÿ** - å®šä½æ€§èƒ½ç“¶é¢ˆ
- **ç›‘æŽ§å¤±è´¥æ¨¡å¼** - ç»Ÿè®¡å„ç§å¤±è´¥åŽŸå› çš„é¢‘çŽ‡
- **éªŒè¯æ¢å¤é€»è¾‘** - ç¡®ä¿å´©æºƒæ¢å¤çš„æ­£ç¡®æ€§

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- äº‹åŠ¡æäº¤éœ€è¦å¤šä¸ªæ—¥å¿—ç³»ç»Ÿåè°ƒä¸€è‡´
- ä¸¤é˜¶æ®µæäº¤ä¿è¯åŽŸå­æ€§ï¼šå‡†å¤‡â†’æäº¤  
- Group Commitä¼˜åŒ–æ€§èƒ½ï¼šæ‰¹é‡å¤„ç†å‡å°‘I/O
- å¤±è´¥å¤„ç†æœºåˆ¶ä¿è¯æ•°æ®ä¸ä¸¢å¤±ä¸é”™ä¹±
- é…ç½®å‚æ•°å¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½éœ€æ±‚