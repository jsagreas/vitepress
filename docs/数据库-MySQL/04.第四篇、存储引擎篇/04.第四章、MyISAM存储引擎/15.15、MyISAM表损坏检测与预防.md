---
title: 15ã€MyISAMè¡¨æŸåæ£€æµ‹ä¸é¢„é˜²
---
## ğŸ“š ç›®å½•


1. [è¡¨æŸååŸºç¡€æ¦‚å¿µ](#1-è¡¨æŸååŸºç¡€æ¦‚å¿µ)
2. [è¡¨æŸåç±»å‹åˆ†ç±»](#2-è¡¨æŸåç±»å‹åˆ†ç±»)
3. [æŸåæ£€æµ‹ç®—æ³•åŸç†](#3-æŸåæ£€æµ‹ç®—æ³•åŸç†)
4. [æ ¡éªŒå’ŒéªŒè¯æœºåˆ¶](#4-æ ¡éªŒå’ŒéªŒè¯æœºåˆ¶)
5. [æŸåæ ¹å› åˆ†ææ–¹æ³•](#5-æŸåæ ¹å› åˆ†ææ–¹æ³•)
6. [é¢„é˜²æ€§æ£€æŸ¥ç­–ç•¥](#6-é¢„é˜²æ€§æ£€æŸ¥ç­–ç•¥)
7. [è‡ªåŠ¨ä¿®å¤è§¦å‘æœºåˆ¶](#7-è‡ªåŠ¨ä¿®å¤è§¦å‘æœºåˆ¶)
8. [è¡¨å¥åº·çŠ¶æ€ç›‘æ§](#8-è¡¨å¥åº·çŠ¶æ€ç›‘æ§)
9. [æŸåé£é™©è¯„ä¼°æ¨¡å‹](#9-æŸåé£é™©è¯„ä¼°æ¨¡å‹)
10. [å®é™…åº”ç”¨æ¡ˆä¾‹](#10-å®é™…åº”ç”¨æ¡ˆä¾‹)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# 1. ğŸ›¡ï¸ è¡¨æŸååŸºç¡€æ¦‚å¿µ



## 1.1 ä»€ä¹ˆæ˜¯è¡¨æŸå



**è¡¨æŸåå®šä¹‰**ï¼šMyISAMè¡¨çš„æ•°æ®æ–‡ä»¶æˆ–ç´¢å¼•æ–‡ä»¶å‡ºç°ä¸ä¸€è‡´ã€é”™è¯¯æˆ–ä¸¢å¤±

```
ç®€å•ç†è§£ï¼š
å°±åƒä¸€æœ¬ä¹¦çš„é¡µç ä¹±äº†ã€å†…å®¹ç¼ºå¤±ã€æˆ–è€…ç›®å½•å¯¹ä¸ä¸Šå†…å®¹
è¡¨æŸåå°±æ˜¯æ•°æ®åº“è¡¨çš„"ä¹¦é¡µ"å‡ºäº†é—®é¢˜
```

**ğŸ”¸ MyISAMè¡¨æŸåçš„ç‰¹æ®Šæ€§**
```
ä¸ºä»€ä¹ˆMyISAMå®¹æ˜“æŸåï¼š
â€¢ æ²¡æœ‰äº‹åŠ¡ä¿æŠ¤ï¼šæ–­ç”µæ—¶å¯èƒ½å†™å…¥ä¸€åŠ
â€¢ è¡¨çº§é”å®šï¼šå¹¶å‘å†™å…¥æ—¶å®¹æ˜“å†²çª
â€¢ æ–‡ä»¶ç›´æ¥æ“ä½œï¼šç³»ç»Ÿæ•…éšœç›´æ¥å½±å“æ–‡ä»¶
â€¢ ç¼ºå°‘æ—¥å¿—ï¼šæ— æ³•å›æ»šæœªå®Œæˆæ“ä½œ

å¯¹æ¯”InnoDBï¼š
MyISAMï¼šç›´æ¥æ“ä½œæ–‡ä»¶ï¼Œå¿«ä½†ä¸å®‰å…¨
InnoDBï¼šé€šè¿‡æ—¥å¿—ç¼“å†²ï¼Œæ…¢ä½†å®‰å…¨
```

## 1.2 æŸåçš„å½±å“èŒƒå›´



**ğŸ’¥ æŸåå½±å“åˆ†æ**
```
æ•°æ®å±‚é¢ï¼š
â€¢ è®°å½•ä¸¢å¤±æˆ–é”™ä¹±
â€¢ ç´¢å¼•æŒ‡å‘é”™è¯¯
â€¢ ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®

æŸ¥è¯¢å±‚é¢ï¼š
â€¢ æŸ¥è¯¢ç»“æœä¸æ­£ç¡®
â€¢ æŸ¥è¯¢æ€§èƒ½æ€¥å‰§ä¸‹é™
â€¢ æŸäº›æŸ¥è¯¢æ— æ³•æ‰§è¡Œ

ç³»ç»Ÿå±‚é¢ï¼š
â€¢ è¡¨æ— æ³•æ‰“å¼€
â€¢ MySQLæœåŠ¡å´©æºƒ
â€¢ æ•´ä¸ªæ•°æ®åº“ä¸å¯ç”¨
```

**ğŸ¯ æŸåä¸¥é‡ç¨‹åº¦åˆ†çº§**
```
è½»å¾®æŸå ğŸŸ¡ï¼š
â€¢ ä¸ªåˆ«è®°å½•æŸå
â€¢ éƒ¨åˆ†ç´¢å¼•ä¸ä¸€è‡´
â€¢ å¤§éƒ¨åˆ†åŠŸèƒ½æ­£å¸¸

ä¸­ç­‰æŸå ğŸŸ ï¼š
â€¢ ç´¢å¼•ä¸¥é‡é”™ä¹±
â€¢ æŸ¥è¯¢ç»“æœä¸å¯ä¿¡
â€¢ éœ€è¦ç«‹å³ä¿®å¤

ä¸¥é‡æŸå ğŸ”´ï¼š
â€¢ è¡¨ç»“æ„ç ´å
â€¢ æ— æ³•è®¿é—®æ•°æ®
â€¢ éœ€è¦ä»å¤‡ä»½æ¢å¤
```

---

# 2. ğŸ” è¡¨æŸåç±»å‹åˆ†ç±»



## 2.1 æŒ‰æŸåä½ç½®åˆ†ç±»



**ğŸ“Š æŸåä½ç½®å›¾ç¤º**
```
MyISAMè¡¨æ–‡ä»¶ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   .frmæ–‡ä»¶      â”‚ â† è¡¨ç»“æ„å®šä¹‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   .MYDæ–‡ä»¶      â”‚ â† æ•°æ®æ–‡ä»¶ï¼ˆå¯èƒ½æŸåï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   .MYIæ–‡ä»¶      â”‚ â† ç´¢å¼•æ–‡ä»¶ï¼ˆå¯èƒ½æŸåï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ æ•°æ®æ–‡ä»¶æŸåï¼ˆ.MYDï¼‰**
```
å¸¸è§ç—‡çŠ¶ï¼š
â€¢ è®°å½•æ•°é‡ä¸åŒ¹é…
â€¢ è®°å½•å†…å®¹ä¹±ç 
â€¢ è¯»å–æ—¶å‡ºç°I/Oé”™è¯¯

æ£€æµ‹å‘½ä»¤ï¼š
CHECK TABLE table_name;

å…¸å‹é”™è¯¯ä¿¡æ¯ï¼š
"Record-count is not ok; is 1000 should be 950"
"Found record with wrong length at offset 1234"
```

**ğŸ”¸ ç´¢å¼•æ–‡ä»¶æŸåï¼ˆ.MYIï¼‰**
```
å¸¸è§ç—‡çŠ¶ï¼š
â€¢ ç´¢å¼•æŒ‡å‘é”™è¯¯ä½ç½®
â€¢ æ’åºç»“æœä¸æ­£ç¡®
â€¢ WHEREæ¡ä»¶æŸ¥è¯¢ç»“æœå¼‚å¸¸

æ£€æµ‹æ–¹æ³•ï¼š
CHECK TABLE table_name EXTENDED;

å…¸å‹é”™è¯¯ä¿¡æ¯ï¼š
"Key in wrong position at page 1234"
"Index file is corrupted"
"Found duplicated keys"
```

**ğŸ”¸ è¡¨ç»“æ„æ–‡ä»¶æŸåï¼ˆ.frmï¼‰**
```
å¸¸è§ç—‡çŠ¶ï¼š
â€¢ è¡¨æ— æ³•æ‰“å¼€
â€¢ å­—æ®µå®šä¹‰ä¸¢å¤±
â€¢ æ˜¾ç¤º"è¡¨ä¸å­˜åœ¨"

æ£€æµ‹ç°è±¡ï¼š
mysql> DESCRIBE table_name;
ERROR 1146: Table 'db.table_name' doesn't exist

ä¿®å¤éš¾åº¦ï¼šæœ€é«˜ï¼Œé€šå¸¸éœ€è¦é‡å»ºè¡¨
```

## 2.2 æŒ‰æŸåç¨‹åº¦åˆ†ç±»



**ğŸ“Š æŸåç¨‹åº¦åˆ†æè¡¨**
| æŸåç±»å‹ | **æ•°æ®å®Œæ•´æ€§** | **ç´¢å¼•å¯ç”¨æ€§** | **ä¿®å¤éš¾åº¦** | **ä¿®å¤æ—¶é—´** |
|----------|----------------|----------------|--------------|--------------|
| ğŸŸ¢ è½»å¾®æŸå | 99%+ | éƒ¨åˆ†å¯ç”¨ | â­ ç®€å• | åˆ†é’Ÿçº§ |
| ğŸŸ¡ ä¸­åº¦æŸå | 90-99% | å¤§éƒ¨åˆ†ä¸å¯ç”¨ | â­â­ ä¸­ç­‰ | å°æ—¶çº§ |
| ğŸŸ  é‡åº¦æŸå | 50-90% | å®Œå…¨ä¸å¯ç”¨ | â­â­â­ å›°éš¾ | å°æ—¶çº§ |
| ğŸ”´ å®Œå…¨æŸå | <50% | æ— æ³•è®¿é—® | â­â­â­â­ æéš¾ | å¤©çº§ |

## 2.3 æŒ‰æŸååŸå› åˆ†ç±»



**âš¡ ç¡¬ä»¶ç›¸å…³æŸå**
```
ç£ç›˜æ•…éšœï¼š
â€¢ åæ‰‡åŒºå¯¼è‡´æ•°æ®ä¸¢å¤±
â€¢ ç£ç›˜å¤´æŸåå½±å“è¯»å†™
â€¢ RAIDé˜µåˆ—å¤±æ•ˆ

å†…å­˜æ•…éšœï¼š
â€¢ å†…å­˜é”™è¯¯å¯¼è‡´æ•°æ®é”™ä¹±
â€¢ ç¼“å­˜åˆ·æ–°å¼‚å¸¸
â€¢ å†…å­˜åœ°å€é”™ä¹±

ç”µæºæ•…éšœï¼š
â€¢ çªç„¶æ–­ç”µä¸­æ–­å†™æ“ä½œ
â€¢ ç”µå‹ä¸ç¨³å½±å“æ•°æ®å®Œæ•´æ€§
â€¢ UPSå¤±æ•ˆå¯¼è‡´éæ­£å¸¸å…³æœº
```

**ğŸ’» è½¯ä»¶ç›¸å…³æŸå**
```
MySQL Bugï¼š
â€¢ å­˜å‚¨å¼•æ“ç¼ºé™·
â€¢ ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
â€¢ å¹¶å‘å¤„ç†é”™è¯¯

æ“ä½œç³»ç»Ÿé—®é¢˜ï¼š
â€¢ æ–‡ä»¶ç³»ç»ŸæŸå
â€¢ å†…æ ¸bugå½±å“I/O
â€¢ ç³»ç»Ÿé…ç½®é”™è¯¯

äººä¸ºè¯¯æ“ä½œï¼š
â€¢ ç›´æ¥ç¼–è¾‘æ•°æ®æ–‡ä»¶
â€¢ é”™è¯¯çš„è¡¨ç»´æŠ¤å‘½ä»¤
â€¢ ä¸å½“çš„æœåŠ¡å™¨å…³é—­
```

---

# 3. ğŸ”¬ æŸåæ£€æµ‹ç®—æ³•åŸç†



## 3.1 CHECK TABLEçš„å·¥ä½œåŸç†



**ğŸ” æ£€æµ‹ç®—æ³•æµç¨‹**
```
CHECK TABLEæ‰§è¡Œæ­¥éª¤ï¼š

ç¬¬1æ­¥ï¼šåŸºç¡€æ–‡ä»¶æ£€æŸ¥
   â†“
æ£€æŸ¥.frmã€.MYDã€.MYIæ–‡ä»¶æ˜¯å¦å­˜åœ¨
   â†“
ç¬¬2æ­¥ï¼šè¡¨å¤´ä¿¡æ¯éªŒè¯
   â†“
æ£€æŸ¥æ–‡ä»¶å¤´çš„é­”æ•°å’Œç‰ˆæœ¬ä¿¡æ¯
   â†“
ç¬¬3æ­¥ï¼šè®°å½•å®Œæ•´æ€§æ£€æŸ¥
   â†“
é€æ¡è¯»å–è®°å½•ï¼ŒéªŒè¯æ ¼å¼å’Œé•¿åº¦
   â†“
ç¬¬4æ­¥ï¼šç´¢å¼•ä¸€è‡´æ€§æ£€æŸ¥
   â†“
éªŒè¯ç´¢å¼•æŒ‡å‘çš„è®°å½•æ˜¯å¦å­˜åœ¨
   â†“
ç¬¬5æ­¥ï¼šç»Ÿè®¡ä¿¡æ¯æ ¡éªŒ
   â†“
å¯¹æ¯”è®°å½•æ•°ã€ç´¢å¼•é¡¹æ•°æ˜¯å¦ä¸€è‡´
```

**ğŸ’¡ æ£€æµ‹çº§åˆ«è¯´æ˜**
```sql
-- å¿«é€Ÿæ£€æŸ¥ï¼ˆé»˜è®¤ï¼‰
CHECK TABLE users;
-- æ£€æŸ¥ï¼šæ–‡ä»¶å¤´ã€è®°å½•è®¡æ•°ã€ç´¢å¼•å®Œæ•´æ€§

-- ä¸­ç­‰æ£€æŸ¥
CHECK TABLE users MEDIUM;
-- é¢å¤–æ£€æŸ¥ï¼šè®°å½•é“¾æ¥ã€åˆ é™¤é“¾æ¥

-- æ‰©å±•æ£€æŸ¥
CHECK TABLE users EXTENDED;
-- æœ€å…¨é¢ï¼šé€ä¸ªéªŒè¯ç´¢å¼•é¡¹å’Œè®°å½•å¯¹åº”å…³ç³»

-- å¿«é€Ÿæ£€æŸ¥ï¼ˆä»…æ£€æŸ¥æ˜¯å¦æ­£ç¡®å…³é—­ï¼‰
CHECK TABLE users QUICK;
-- ç”¨äºå¯åŠ¨æ—¶çš„å¿«é€ŸéªŒè¯
```

## 3.2 myisamchkå·¥å…·çš„æ£€æµ‹æœºåˆ¶



**ğŸ”§ myisamchkæ£€æµ‹åŸç†**
```bash
# åŸºæœ¬è¯­æ³•

myisamchk [é€‰é¡¹] è¡¨æ–‡ä»¶è·¯å¾„

# æ£€æµ‹çº§åˆ«å¯¹æ¯”

myisamchk table.MYI              # åŸºç¡€æ£€æŸ¥
myisamchk --medium-check table.MYI    # ä¸­çº§æ£€æŸ¥  
myisamchk --extend-check table.MYI    # å®Œå…¨æ£€æŸ¥
```

**ğŸ“Š æ£€æµ‹ç®—æ³•è¯¦è§£**
```
åŸºç¡€æ£€æŸ¥ç®—æ³•ï¼š
1. è¯»å–ç´¢å¼•å¤´ä¿¡æ¯
2. æ£€æŸ¥ç´¢å¼•ç»“æ„å®Œæ•´æ€§
3. éªŒè¯è®°å½•æ•°é‡ç»Ÿè®¡
4. æ£€æŸ¥åˆ é™¤è®°å½•é“¾è¡¨

ä¸­çº§æ£€æŸ¥ç®—æ³•ï¼š
+ éªŒè¯æ¯ä¸ªç´¢å¼•é¡µçš„é“¾æ¥
+ æ£€æŸ¥B-treeç»“æ„å®Œæ•´æ€§
+ éªŒè¯è®°å½•æŒ‡é’ˆæœ‰æ•ˆæ€§

æ‰©å±•æ£€æŸ¥ç®—æ³•ï¼š
+ é€ä¸ªéªŒè¯ç´¢å¼•æ¡ç›®
+ æ£€æŸ¥æ¯æ¡è®°å½•çš„ç´¢å¼•è¦†ç›–
+ éªŒè¯æ’åºé¡ºåºæ­£ç¡®æ€§
+ è®¡ç®—å¹¶éªŒè¯æ ¡éªŒå’Œ
```

## 3.3 æŸåæ£€æµ‹çš„æ€§èƒ½è€ƒè™‘



**âš¡ æ£€æµ‹æ€§èƒ½åˆ†æ**
```
æ£€æµ‹æ—¶é—´ä¼°ç®—ï¼ˆ1GBè¡¨ä¸ºä¾‹ï¼‰ï¼š

QUICKæ£€æŸ¥ï¼š
â€¢ æ—¶é—´ï¼š1-2ç§’
â€¢ åŸç†ï¼šåªæ£€æŸ¥æ–‡ä»¶å¤´å’Œç»Ÿè®¡ä¿¡æ¯
â€¢ é€‚ç”¨ï¼šæ—¥å¸¸å¿«é€ŸéªŒè¯

MEDIUMæ£€æŸ¥ï¼š
â€¢ æ—¶é—´ï¼š10-30ç§’
â€¢ åŸç†ï¼šæ£€æŸ¥ç´¢å¼•ç»“æ„å’Œè®°å½•é“¾æ¥
â€¢ é€‚ç”¨ï¼šå®šæœŸå¥åº·æ£€æŸ¥

EXTENDEDæ£€æŸ¥ï¼š
â€¢ æ—¶é—´ï¼š5-15åˆ†é’Ÿ
â€¢ åŸç†ï¼šå®Œå…¨éªŒè¯æ•°æ®ä¸€è‡´æ€§
â€¢ é€‚ç”¨ï¼šæ·±åº¦æ•…éšœæ’æŸ¥
```

**ğŸ¯ æ£€æµ‹ç­–ç•¥é€‰æ‹©**
| ä½¿ç”¨åœºæ™¯ | **æ£€æµ‹çº§åˆ«** | **é¢‘ç‡å»ºè®®** | **èµ„æºæ¶ˆè€—** |
|----------|--------------|--------------|--------------|
| æ—¥å¸¸ç›‘æ§ | QUICK | æ¯å°æ—¶ | ğŸŸ¢ æä½ |
| å®šæœŸç»´æŠ¤ | MEDIUM | æ¯å¤© | ğŸŸ¡ ä¸­ç­‰ |
| æ•…éšœæ’æŸ¥ | EXTENDED | æŒ‰éœ€ | ğŸ”´ è¾ƒé«˜ |
| å¯åŠ¨æ£€æŸ¥ | QUICK | æ¯æ¬¡å¯åŠ¨ | ğŸŸ¢ æä½ |

---

# 4. ğŸ” æ ¡éªŒå’ŒéªŒè¯æœºåˆ¶



## 4.1 æ ¡éªŒå’ŒåŸºæœ¬åŸç†



**ğŸ”¸ æ ¡éªŒå’Œçš„ä½œç”¨**
```
æ ¡éªŒå’Œå°±åƒå¿«é€’çš„"é˜²ä¼ªç "ï¼š
å‘é€æ—¶ï¼šæ ¹æ®å†…å®¹è®¡ç®—ä¸€ä¸ªç‰¹å¾å€¼
æ¥æ”¶æ—¶ï¼šé‡æ–°è®¡ç®—ï¼Œå¯¹æ¯”æ˜¯å¦ä¸€è‡´
å¦‚æœä¸ä¸€è‡´ï¼šè¯´æ˜å†…å®¹åœ¨ä¼ è¾“ä¸­è¢«æŸå

MyISAMæ ¡éªŒå’Œï¼š
å†™å…¥æ—¶ï¼šè®¡ç®—è®°å½•å’Œç´¢å¼•çš„æ ¡éªŒå’Œ
è¯»å–æ—¶ï¼šé‡æ–°è®¡ç®—å¹¶å¯¹æ¯”
ä¸ä¸€è‡´æ—¶ï¼šæŠ¥å‘ŠæŸåé”™è¯¯
```

## 4.2 æ ¡éªŒå’Œè®¡ç®—æ–¹æ³•



**ğŸ“Š MyISAMæ ¡éªŒå’Œç®—æ³•**
```c
// ç®€åŒ–çš„æ ¡éªŒå’Œè®¡ç®—ç¤ºä¾‹
uint32_t calculate_checksum(char *data, size_t length) {
    uint32_t checksum = 0;
    
    for (size_t i = 0; i < length; i++) {
        checksum = checksum * 31 + (unsigned char)data[i];
    }
    
    return checksum;
}

// è®°å½•çº§æ ¡éªŒå’Œ
uint32_t record_checksum(MyISAM_RECORD *record) {
    return calculate_checksum(record->data, record->length);
}

// é¡µçº§æ ¡éªŒå’Œ
uint32_t page_checksum(MyISAM_PAGE *page) {
    return calculate_checksum((char*)page, page->size);
}
```

## 4.3 å¯ç”¨å’Œé…ç½®æ ¡éªŒå’Œ



**âš™ï¸ æ ¡éªŒå’Œé…ç½®**
```sql
-- æŸ¥çœ‹å½“å‰æ ¡éªŒå’Œè®¾ç½®
SHOW TABLE STATUS LIKE 'table_name'\G
-- Checksumå­—æ®µæ˜¾ç¤ºæ ¡éªŒå’ŒçŠ¶æ€

-- å¯ç”¨è¡¨çº§æ ¡éªŒå’Œ
ALTER TABLE users CHECKSUM = 1;

-- åˆ›å»ºè¡¨æ—¶å¯ç”¨æ ¡éªŒå’Œ
CREATE TABLE products (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2)
) ENGINE=MyISAM CHECKSUM=1;

-- æ‰‹åŠ¨éªŒè¯æ ¡éªŒå’Œ
CHECKSUM TABLE users;
CHECKSUM TABLE users EXTENDED;  -- é‡æ–°è®¡ç®—æ ¡éªŒå’Œ
```

**ğŸ’¡ æ ¡éªŒå’Œæ€§èƒ½å½±å“**
```
å¯ç”¨æ ¡éªŒå’Œçš„ä»£ä»·ï¼š
â€¢ å†™å…¥æ€§èƒ½ï¼šä¸‹é™5-10%
â€¢ å­˜å‚¨ç©ºé—´ï¼šæ¯ä¸ªé¡µå¢åŠ 4å­—èŠ‚
â€¢ æ£€æŸ¥æ—¶é—´ï¼šå¢åŠ 10-20%

æ”¶ç›Šåˆ†æï¼š
â€¢ åŠæ—¶å‘ç°æ•°æ®æŸå
â€¢ å‡å°‘é”™è¯¯æ•°æ®ä¼ æ’­
â€¢ æé«˜ç³»ç»Ÿå¯é æ€§

å»ºè®®ï¼šé‡è¦è¡¨å»ºè®®å¯ç”¨ï¼Œä¸´æ—¶è¡¨å¯ä¸å¯ç”¨
```

---

# 5. ğŸ•µï¸ æŸåæ ¹å› åˆ†ææ–¹æ³•



## 5.1 å¸¸è§æŸååŸå› åˆ†æ



**ğŸ”§ ç¡¬ä»¶æ•…éšœå¯¼è‡´çš„æŸå**
```
ç£ç›˜æ•…éšœç‰¹å¾ï¼š
â€¢ å‡ºç°I/Oé”™è¯¯æ—¥å¿—
â€¢ è¯»å†™é€Ÿåº¦çªç„¶ä¸‹é™
â€¢ SMARTæ£€æµ‹æ˜¾ç¤ºå¼‚å¸¸

è¯Šæ–­æ–¹æ³•ï¼š
# æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—

dmesg | grep -i "error"
grep -i "mysql" /var/log/messages

# æ£€æŸ¥ç£ç›˜å¥åº·

smartctl -a /dev/sda
iostat -x 1 10

# MySQLé”™è¯¯æ—¥å¿—

tail -f /var/log/mysql/error.log
```

**âš¡ ç”µæºæ•…éšœæŸååˆ†æ**
```
å…¸å‹ç°è±¡ï¼š
â€¢ è¡¨çŠ¶æ€æ˜¾ç¤º"crashed"
â€¢ ç´¢å¼•æ–‡ä»¶å¤§å°ä¸º0
â€¢ æœ€è¿‘çš„è®°å½•ä¸¢å¤±

åˆ†ææ–¹æ³•ï¼š
1. æ£€æŸ¥ç³»ç»Ÿé‡å¯æ—¶é—´
2. å¯¹æ¯”è¡¨çš„æœ€åä¿®æ”¹æ—¶é—´
3. åˆ†æMySQLé”™è¯¯æ—¥å¿—çš„æ—¶é—´ç‚¹
4. æ£€æŸ¥UPSæ—¥å¿—ï¼ˆå¦‚æœæœ‰ï¼‰

é¢„é˜²æªæ–½ï¼š
â€¢ é…ç½®UPSä¸é—´æ–­ç”µæº
â€¢ è®¾ç½®MySQLæ…¢å…³é—­
â€¢ å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—
```

## 5.2 è½¯ä»¶é—®é¢˜æ’æŸ¥



**ğŸ› MySQLç‰ˆæœ¬bugæ’æŸ¥**
```sql
-- æ£€æŸ¥MySQLç‰ˆæœ¬
SELECT VERSION();

-- æŸ¥çœ‹å·²çŸ¥bugåˆ—è¡¨
SHOW VARIABLES LIKE '%version%';

-- æ£€æŸ¥å­˜å‚¨å¼•æ“çŠ¶æ€
SHOW ENGINE MyISAM STATUS;

-- åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—
-- æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸çš„æŸ¥è¯¢æ¨¡å¼
```

**ğŸ‘¤ äººä¸ºè¯¯æ“ä½œè¯†åˆ«**
```
å¸¸è§è¯¯æ“ä½œï¼š
â€¢ ç›´æ¥åˆ é™¤æˆ–ä¿®æ”¹.MYD/.MYIæ–‡ä»¶
â€¢ åœ¨MySQLè¿è¡Œæ—¶æ‹·è´è¡¨æ–‡ä»¶
â€¢ ä½¿ç”¨é”™è¯¯çš„å­—ç¬¦é›†å¯¼å…¥æ•°æ®

è¯†åˆ«æ–¹æ³•ï¼š
1. æ£€æŸ¥æ“ä½œç³»ç»Ÿå®¡è®¡æ—¥å¿—
2. åˆ†æMySQLæ“ä½œæ—¥å¿—
3. æ£€æŸ¥æ–‡ä»¶ä¿®æ”¹æ—¶é—´æˆ³
4. è¯¢é—®ç›¸å…³æ“ä½œäººå‘˜
```

## 5.3 æŸåæ¨¡å¼è¯†åˆ«



**ğŸ¯ å…¸å‹æŸåæ¨¡å¼**
```
æ¨¡å¼1ï¼šç´¢å¼•æŸåï¼Œæ•°æ®å®Œå¥½
ç°è±¡ï¼šæŸ¥è¯¢æ…¢ï¼Œæ’åºé”™ä¹±ï¼ŒCOUNT(*)ä¸å‡†ç¡®
åŸå› ï¼šç´¢å¼•æ›´æ–°ä¸­æ–­
ä¿®å¤ï¼šé‡å»ºç´¢å¼•

æ¨¡å¼2ï¼šæ•°æ®æŸåï¼Œç´¢å¼•å®Œå¥½  
ç°è±¡ï¼šè¿”å›é”™è¯¯è®°å½•ï¼Œè®°å½•æ•°ä¸åŒ¹é…
åŸå› ï¼šæ•°æ®å†™å…¥ä¸­æ–­
ä¿®å¤ï¼šä»ç´¢å¼•é‡å»ºæ•°æ®æŒ‡é’ˆ

æ¨¡å¼3ï¼šç»“æ„æ€§æŸå
ç°è±¡ï¼šè¡¨æ— æ³•æ‰“å¼€ï¼Œæ˜¾ç¤ºä¸å­˜åœ¨
åŸå› ï¼š.frmæ–‡ä»¶æŸå
ä¿®å¤ï¼šä»å¤‡ä»½æ¢å¤æˆ–é‡å»ºè¡¨ç»“æ„
```

---

# 6. âœ… é¢„é˜²æ€§æ£€æŸ¥ç­–ç•¥



## 6.1 æ—¥å¸¸æ£€æŸ¥è®¡åˆ’



**ğŸ“… åˆ†å±‚æ£€æŸ¥ç­–ç•¥**
```
æ¯å°æ—¶æ£€æŸ¥ï¼ˆå¿«é€Ÿï¼‰ï¼š
â€¢ æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
â€¢ æŸ¥çœ‹é”™è¯¯æ—¥å¿—æ–°å¢å†…å®¹
â€¢ ç›‘æ§ç£ç›˜I/Oå¼‚å¸¸

æ¯æ—¥æ£€æŸ¥ï¼ˆåŸºç¡€ï¼‰ï¼š
â€¢ æ‰§è¡ŒQUICKçº§åˆ«çš„è¡¨æ£€æŸ¥
â€¢ æ£€æŸ¥è¡¨å¤§å°å’Œè®°å½•æ•°å˜åŒ–
â€¢ éªŒè¯å…³é”®è¡¨çš„æ ¡éªŒå’Œ

æ¯å‘¨æ£€æŸ¥ï¼ˆä¸­ç­‰ï¼‰ï¼š
â€¢ æ‰§è¡ŒMEDIUMçº§åˆ«æ£€æŸ¥
â€¢ åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—
â€¢ æ£€æŸ¥ç£ç›˜ç©ºé—´å’Œç¢ç‰‡

æ¯æœˆæ£€æŸ¥ï¼ˆæ·±åº¦ï¼‰ï¼š
â€¢ æ‰§è¡ŒEXTENDEDçº§åˆ«æ£€æŸ¥
â€¢ å®Œæ•´çš„è¡¨ä¼˜åŒ–å’Œé‡å»ºç´¢å¼•
â€¢ ç³»ç»Ÿæ•´ä½“å¥åº·è¯„ä¼°
```

## 6.2 è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬



**ğŸ¤– æ—¥å¸¸æ£€æŸ¥è„šæœ¬**
```bash
#!/bin/bash

# myisam_health_check.sh


DATABASE="your_database"
LOG_FILE="/var/log/mysql/health_check.log"
DATE=$(date '+%Y-%m-%d %H:%M:%S')

echo "[$DATE] å¼€å§‹MyISAMè¡¨å¥åº·æ£€æŸ¥" >> $LOG_FILE

# è·å–æ‰€æœ‰MyISAMè¡¨

TABLES=$(mysql -e "
SELECT TABLE_NAME 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA='$DATABASE' 
  AND ENGINE='MyISAM'" -s -N)

# æ£€æŸ¥æ¯ä¸ªè¡¨

for table in $TABLES; do
    echo "æ£€æŸ¥è¡¨: $table"
    
#    # å¿«é€Ÿæ£€æŸ¥
    RESULT=$(mysql $DATABASE -e "CHECK TABLE $table QUICK" -s -N | cut -f4)
    
    if [ "$RESULT" != "OK" ]; then
        echo "[$DATE] è­¦å‘Š: è¡¨ $table çŠ¶æ€å¼‚å¸¸: $RESULT" >> $LOG_FILE
        
#        # å‘é€å‘Šè­¦é‚®ä»¶
        echo "è¡¨æŸåå‘Šè­¦: $table" | mail -s "æ•°æ®åº“å¼‚å¸¸" admin@company.com
        
#        # å°è¯•ä¿®å¤
        mysql $DATABASE -e "REPAIR TABLE $table"
    fi
done

echo "[$DATE] MyISAMè¡¨å¥åº·æ£€æŸ¥å®Œæˆ" >> $LOG_FILE
```

## 6.3 é¢„é˜²æ€§ç»´æŠ¤ç­–ç•¥



**ğŸ› ï¸ å®šæœŸç»´æŠ¤ä»»åŠ¡**
```sql
-- æ¯å‘¨æ‰§è¡Œï¼šè¡¨ä¼˜åŒ–å’Œç¢ç‰‡æ•´ç†
OPTIMIZE TABLE users, orders, products;

-- æ¯æœˆæ‰§è¡Œï¼šé‡å»ºç´¢å¼•
ALTER TABLE users DISABLE KEYS;
ALTER TABLE users ENABLE KEYS;

-- å­£åº¦æ‰§è¡Œï¼šè¡¨é‡å»º
CREATE TABLE users_new LIKE users;
INSERT INTO users_new SELECT * FROM users;
RENAME TABLE users TO users_old, users_new TO users;
DROP TABLE users_old;
```

**ğŸ“Š ç£ç›˜ç©ºé—´ç›‘æ§**
```bash
# ç›‘æ§æ•°æ®ç›®å½•ç©ºé—´

df -h /var/lib/mysql

# æ£€æŸ¥å•ä¸ªè¡¨æ–‡ä»¶å¤§å°

ls -lh /var/lib/mysql/database_name/

# æ£€æŸ¥ç¢ç‰‡ç‡

mysql -e "
SELECT TABLE_NAME,
       ROUND(DATA_LENGTH/1024/1024,2) AS 'Data MB',
       ROUND(DATA_FREE/1024/1024,2) AS 'Free MB',
       ROUND((DATA_FREE/(DATA_LENGTH+INDEX_LENGTH))*100,2) AS 'Frag%'
FROM information_schema.TABLES 
WHERE ENGINE='MyISAM' AND DATA_FREE > 0
ORDER BY DATA_FREE DESC;
"
```

---

# 7. ğŸ¤– è‡ªåŠ¨ä¿®å¤è§¦å‘æœºåˆ¶



## 7.1 è‡ªåŠ¨ä¿®å¤ç­–ç•¥



**ğŸ”„ ä¿®å¤è§¦å‘æ¡ä»¶**
```
è‡ªåŠ¨è§¦å‘ä¿®å¤çš„æƒ…å†µï¼š
â€¢ CHECK TABLEè¿”å›erroræˆ–warning
â€¢ æŸ¥è¯¢æ—¶å‡ºç°"Table is marked as crashed"
â€¢ ç´¢å¼•æ–‡ä»¶å¤§å°ä¸º0
â€¢ è®°å½•æ•°é‡ä¸¥é‡ä¸åŒ¹é…ï¼ˆ>5%å·®å¼‚ï¼‰

ä¿®å¤ä¼˜å…ˆçº§ï¼š
1. è½»å¾®æŸå â†’ REPAIR TABLE
2. ä¸­åº¦æŸå â†’ REPAIR TABLE EXTENDED
3. é‡åº¦æŸå â†’ myisamchk --safe-recover
4. å®Œå…¨æŸå â†’ ä»å¤‡ä»½æ¢å¤
```

## 7.2 æ™ºèƒ½ä¿®å¤è„šæœ¬



**ğŸ§  æ™ºèƒ½ä¿®å¤é€»è¾‘**
```bash
#!/bin/bash

# smart_repair.sh - æ™ºèƒ½è¡¨ä¿®å¤è„šæœ¬


repair_table() {
    local database=$1
    local table=$2
    local backup_dir="/backup/mysql_repair"
    
    echo "å¼€å§‹ä¿®å¤è¡¨: $database.$table"
    
#    # ç¬¬1æ­¥ï¼šåˆ›å»ºå¤‡ä»½
    mkdir -p $backup_dir
    cp /var/lib/mysql/$database/$table.* $backup_dir/
    
#    # ç¬¬2æ­¥ï¼šå°è¯•å¿«é€Ÿä¿®å¤
    RESULT=$(mysql $database -e "REPAIR TABLE $table QUICK" -s -N | cut -f4)
    
    if [ "$RESULT" = "OK" ]; then
        echo "å¿«é€Ÿä¿®å¤æˆåŠŸ"
        return 0
    fi
    
#    # ç¬¬3æ­¥ï¼šå°è¯•æ ‡å‡†ä¿®å¤
    RESULT=$(mysql $database -e "REPAIR TABLE $table" -s -N | cut -f4)
    
    if [ "$RESULT" = "OK" ]; then
        echo "æ ‡å‡†ä¿®å¤æˆåŠŸ"
        return 0
    fi
    
#    # ç¬¬4æ­¥ï¼šå°è¯•æ‰©å±•ä¿®å¤
    RESULT=$(mysql $database -e "REPAIR TABLE $table EXTENDED" -s -N | cut -f4)
    
    if [ "$RESULT" = "OK" ]; then
        echo "æ‰©å±•ä¿®å¤æˆåŠŸ"
        return 0
    fi
    
#    # ç¬¬5æ­¥ï¼šä½¿ç”¨myisamchkä¿®å¤
    systemctl stop mysql
    myisamchk --safe-recover /var/lib/mysql/$database/$table.MYI
    systemctl start mysql
    
#    # éªŒè¯ä¿®å¤ç»“æœ
    FINAL_CHECK=$(mysql $database -e "CHECK TABLE $table" -s -N | cut -f4)
    
    if [ "$FINAL_CHECK" = "OK" ]; then
        echo "myisamchkä¿®å¤æˆåŠŸ"
        return 0
    else
        echo "ä¿®å¤å¤±è´¥ï¼Œéœ€è¦ä»å¤‡ä»½æ¢å¤"
        return 1
    fi
}
```

## 7.3 ä¿®å¤è§¦å‘æ¡ä»¶é…ç½®



**âš™ï¸ MySQLé…ç½®ä¼˜åŒ–**
```ini
# my.cnf - è‡ªåŠ¨ä¿®å¤ç›¸å…³é…ç½®

[mysqld]
# å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥MyISAMè¡¨

myisam-recover-options = BACKUP,FORCE

# è‡ªåŠ¨ä¿®å¤çº§åˆ«

# DEFAULT: æ ‡å‡†ä¿®å¤

# BACKUP: ä¿®å¤å‰å¤‡ä»½.MYDæ–‡ä»¶

# FORCE: å¼ºåˆ¶ä¿®å¤ï¼Œå³ä½¿ä¸¢å¤±å¤šè¡Œ

# QUICK: å¿«é€Ÿä¿®å¤ï¼Œä¸æ£€æŸ¥æ‰€æœ‰è¡Œ


# æ£€æŸ¥ç‚¹è®¾ç½®

key_buffer_size = 256M          # å¢å¤§ç´¢å¼•ç¼“å­˜
myisam_sort_buffer_size = 128M  # ä¼˜åŒ–ä¿®å¤æ€§èƒ½
```

**ğŸ”” å‘Šè­¦é€šçŸ¥æœºåˆ¶**
```bash
# é…ç½®é‚®ä»¶å‘Šè­¦

configure_alerts() {
#    # åœ¨crontabä¸­æ·»åŠ æ£€æŸ¥ä»»åŠ¡
    echo "0 */6 * * * /usr/local/bin/check_myisam_health.sh" >> /etc/crontab
    
#    # é…ç½®é‚®ä»¶æœåŠ¡
    apt-get install mailutils
    
#    # è®¾ç½®å‘Šè­¦é˜ˆå€¼
    CORRUPTION_THRESHOLD=5  # æŸåè¡¨æ•°é‡é˜ˆå€¼
    REPAIR_TIME_LIMIT=300   # ä¿®å¤æ—¶é—´é™åˆ¶ï¼ˆç§’ï¼‰
}
```

---

# 8. ğŸ“Š è¡¨å¥åº·çŠ¶æ€ç›‘æ§



## 8.1 å…³é”®ç›‘æ§æŒ‡æ ‡



**ğŸ¯ æ ¸å¿ƒå¥åº·æŒ‡æ ‡**
```sql
-- è¡¨çŠ¶æ€ç»¼åˆæŸ¥è¯¢
SELECT 
    TABLE_NAME as 'è¡¨å',
    TABLE_ROWS as 'è®°å½•æ•°',
    ROUND(DATA_LENGTH/1024/1024,2) as 'æ•°æ®å¤§å°MB',
    ROUND(INDEX_LENGTH/1024/1024,2) as 'ç´¢å¼•å¤§å°MB',
    ROUND(DATA_FREE/1024/1024,2) as 'ç¢ç‰‡MB',
    UPDATE_TIME as 'æœ€åæ›´æ–°æ—¶é—´',
    CHECK_TIME as 'æœ€åæ£€æŸ¥æ—¶é—´'
FROM information_schema.TABLES 
WHERE ENGINE = 'MyISAM' 
  AND TABLE_SCHEMA = DATABASE()
ORDER BY DATA_FREE DESC;
```

**ğŸ“ˆ å¥åº·è¯„åˆ†ç®—æ³•**
```
è¡¨å¥åº·è¯„åˆ†è®¡ç®—ï¼š

åŸºç¡€åˆ†æ•°ï¼š100åˆ†

æ‰£åˆ†é¡¹ï¼š
â€¢ æœ‰ç¢ç‰‡ï¼š-10åˆ†ï¼ˆæ¯10%ç¢ç‰‡ç‡ï¼‰
â€¢ é•¿æ—¶é—´æœªæ£€æŸ¥ï¼š-5åˆ†ï¼ˆæ¯è¶…è¿‡7å¤©ï¼‰
â€¢ æ–‡ä»¶å¤§å°å¼‚å¸¸ï¼š-20åˆ†
â€¢ æ ¡éªŒå’Œé”™è¯¯ï¼š-50åˆ†
â€¢ æ›¾ç»æŸåè¿‡ï¼š-15åˆ†

å¥åº·ç­‰çº§ï¼š
90-100åˆ†ï¼šğŸŸ¢ å¥åº·
70-89åˆ†ï¼šğŸŸ¡  ä¸€èˆ¬
50-69åˆ†ï¼šğŸŸ   é£é™©
<50åˆ†ï¼šğŸ”´   å±é™©
```

## 8.2 ç›‘æ§è„šæœ¬å®ç°



**ğŸ“Š å¥åº·çŠ¶æ€ç›‘æ§**
```python
#!/usr/bin/env python3

# myisam_monitor.py


import mysql.connector
import smtplib
from datetime import datetime, timedelta

class MyISAMHealthMonitor:
    def __init__(self, host, user, password, database):
        self.db = mysql.connector.connect(
            host=host, user=user, password=password, database=database
        )
    
    def check_table_health(self):
        cursor = self.db.cursor()
        
#        # è·å–MyISAMè¡¨ä¿¡æ¯
        query = """
        SELECT TABLE_NAME, TABLE_ROWS, DATA_LENGTH, INDEX_LENGTH, 
               DATA_FREE, UPDATE_TIME, CHECK_TIME
        FROM information_schema.TABLES 
        WHERE ENGINE = 'MyISAM' AND TABLE_SCHEMA = %s
        """
        
        cursor.execute(query, (self.database,))
        tables = cursor.fetchall()
        
        health_report = []
        
        for table in tables:
            name, rows, data_len, index_len, data_free, update_time, check_time = table
            
#            # è®¡ç®—å¥åº·è¯„åˆ†
            score = 100
            
#            # ç¢ç‰‡ç‡æ£€æŸ¥
            if data_len > 0:
                frag_rate = (data_free / (data_len + index_len)) * 100
                score -= int(frag_rate / 10) * 10
            
#            # æ£€æŸ¥æ—¶é—´
            if check_time:
                days_since_check = (datetime.now() - check_time).days
                if days_since_check > 7:
                    score -= (days_since_check - 7) * 5
            
#            # æ‰§è¡ŒCHECK TABLE
            cursor.execute(f"CHECK TABLE {name} QUICK")
            check_result = cursor.fetchone()
            status = check_result[3] if check_result else "Unknown"
            
            if status != "OK":
                score -= 50
            
            health_report.append({
                'table': name,
                'score': max(0, score),
                'status': status,
                'fragmentation': frag_rate if 'frag_rate' in locals() else 0
            })
        
        return health_report
    
    def generate_alert(self, unhealthy_tables):
        if not unhealthy_tables:
            return
        
        message = "MyISAMè¡¨å¥åº·å‘Šè­¦:\n\n"
        for table in unhealthy_tables:
            message += f"è¡¨: {table['table']}\n"
            message += f"å¥åº·è¯„åˆ†: {table['score']}\n"
            message += f"çŠ¶æ€: {table['status']}\n\n"
        
#        # å‘é€é‚®ä»¶å‘Šè­¦ï¼ˆç®€åŒ–ï¼‰
        print(f"å‘Šè­¦: {len(unhealthy_tables)}ä¸ªè¡¨éœ€è¦å…³æ³¨")
        print(message)

# ä½¿ç”¨ç¤ºä¾‹

monitor = MyISAMHealthMonitor('localhost', 'user', 'pass', 'mydb')
health_data = monitor.check_table_health()

# ç­›é€‰éœ€è¦å…³æ³¨çš„è¡¨

unhealthy = [t for t in health_data if t['score'] < 70]
monitor.generate_alert(unhealthy)
```

---

# 9. âš–ï¸ æŸåé£é™©è¯„ä¼°æ¨¡å‹



## 9.1 é£é™©å› ç´ è¯„ä¼°



**ğŸ¯ é£é™©å› ç´ æƒé‡æ¨¡å‹**
```
é£é™©è¯„ä¼°ç®—æ³•ï¼š

ç¡¬ä»¶é£é™©ï¼ˆæƒé‡40%ï¼‰ï¼š
â€¢ ç£ç›˜ä½¿ç”¨å¹´é™ï¼š>3å¹´ +20åˆ†
â€¢ ç£ç›˜ä½¿ç”¨ç‡ï¼š>80% +15åˆ†
â€¢ I/Oé”™è¯¯å†å²ï¼šæœ‰è®°å½• +30åˆ†
â€¢ ç¡¬ä»¶RAIDçŠ¶æ€ï¼šé™çº§ +25åˆ†

è½¯ä»¶é£é™©ï¼ˆæƒé‡30%ï¼‰ï¼š
â€¢ MySQLç‰ˆæœ¬ï¼šæ—§ç‰ˆæœ¬ +15åˆ†
â€¢ é…ç½®ä¼˜åŒ–ç¨‹åº¦ï¼šæœªä¼˜åŒ– +20åˆ†
â€¢ å¹¶å‘è®¿é—®é‡ï¼šé«˜å¹¶å‘ +10åˆ†

æ“ä½œé£é™©ï¼ˆæƒé‡20%ï¼‰ï¼š
â€¢ ç»´æŠ¤é¢‘ç‡ï¼šä½é¢‘ +15åˆ†
â€¢ æ“ä½œè§„èŒƒæ€§ï¼šä¸è§„èŒƒ +25åˆ†
â€¢ å¤‡ä»½å®Œæ•´æ€§ï¼šä¸å®Œæ•´ +20åˆ†

ç¯å¢ƒé£é™©ï¼ˆæƒé‡10%ï¼‰ï¼š
â€¢ ç”µæºç¨³å®šæ€§ï¼šä¸ç¨³å®š +20åˆ†
â€¢ æ¸©åº¦æ¹¿åº¦ï¼šå¼‚å¸¸ +10åˆ†
â€¢ ç½‘ç»œç¨³å®šæ€§ï¼šä¸ç¨³å®š +5åˆ†

æ€»åˆ†>70åˆ†ï¼šé«˜é£é™© ğŸ”´
æ€»åˆ†40-70ï¼šä¸­é£é™© ğŸŸ¡
æ€»åˆ†<40ï¼šä½é£é™© ğŸŸ¢
```

## 9.2 é£é™©é¢„æµ‹æ¨¡å‹



**ğŸ“ˆ åŸºäºå†å²æ•°æ®çš„é¢„æµ‹**
```sql
-- åˆ›å»ºé£é™©è¯„ä¼°è¡¨
CREATE TABLE myisam_risk_assessment (
    assessment_date DATE,
    table_name VARCHAR(100),
    risk_score INT,
    hardware_risk INT,
    software_risk INT,
    operation_risk INT,
    environment_risk INT,
    predicted_failure_date DATE,
    recommendation TEXT
);

-- é£é™©è¶‹åŠ¿åˆ†æ
SELECT 
    table_name,
    AVG(risk_score) as avg_risk,
    STDDEV(risk_score) as risk_volatility,
    MAX(risk_score) as max_risk,
    COUNT(*) as assessments
FROM myisam_risk_assessment 
WHERE assessment_date >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY table_name
ORDER BY avg_risk DESC;
```

## 9.3 é£é™©ç¼“è§£ç­–ç•¥



**ğŸ›¡ï¸ åˆ†çº§ç¼“è§£æªæ–½**
```
é«˜é£é™©è¡¨ï¼ˆåˆ†æ•°>70ï¼‰ï¼š
â€¢ æ¯æ—¥å¤šæ¬¡æ£€æŸ¥
â€¢ å¢åŠ å¤‡ä»½é¢‘ç‡
â€¢ è€ƒè™‘è¿ç§»åˆ°InnoDB
â€¢ 24å°æ—¶ç›‘æ§

ä¸­é£é™©è¡¨ï¼ˆåˆ†æ•°40-70ï¼‰ï¼š
â€¢ æ¯æ—¥æ£€æŸ¥ä¸€æ¬¡
â€¢ æ¯å‘¨æ·±åº¦æ£€æŸ¥
â€¢ ä¼˜åŒ–è¡¨ç»“æ„å’Œç´¢å¼•
â€¢ æ”¹å–„ç¡¬ä»¶æ¡ä»¶

ä½é£é™©è¡¨ï¼ˆåˆ†æ•°<40ï¼‰ï¼š
â€¢ æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡
â€¢ æŒ‰æ ‡å‡†ç»´æŠ¤è®¡åˆ’
â€¢ ä¿æŒç°æœ‰é˜²æŠ¤æªæ–½
```

---

# 10. ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹



## 10.1 æ¡ˆä¾‹ï¼šç”µå•†è®¢å•è¡¨æŸåå¤„ç†



**ğŸ“‹ åœºæ™¯æè¿°**
```
é—®é¢˜ï¼šç”µå•†ç½‘ç«™è®¢å•è¡¨çªç„¶å‡ºç°æŸ¥è¯¢å¼‚å¸¸
ç°è±¡ï¼š
â€¢ SELECT COUNT(*) ç»“æœä¸ä¸€è‡´
â€¢ éƒ¨åˆ†è®¢å•æŸ¥è¯¢ä¸åˆ°
â€¢ åå°æŠ¥è¡¨æ•°æ®å¼‚å¸¸

åˆæ­¥è¯Šæ–­ï¼š
mysql> CHECK TABLE orders;
+-------+-------+----------+----------+
| Table | Op    | Msg_type | Msg_text |
+-------+-------+----------+----------+
| orders| check | error    | record count is not ok |
+-------+-------+----------+----------+
```

**ğŸ”§ å¤„ç†æµç¨‹**
```sql
-- ç¬¬1æ­¥ï¼šè¯„ä¼°æŸåç¨‹åº¦
CHECK TABLE orders EXTENDED;
-- å‘ç°ï¼šç´¢å¼•ä¸ä¸€è‡´ï¼Œä½†æ•°æ®å®Œæ•´

-- ç¬¬2æ­¥ï¼šå¤‡ä»½å½“å‰çŠ¶æ€
CREATE TABLE orders_backup_20250902 AS SELECT * FROM orders;

-- ç¬¬3æ­¥ï¼šå°è¯•ä¿®å¤
REPAIR TABLE orders;
-- ç»“æœï¼šä¿®å¤æˆåŠŸ

-- ç¬¬4æ­¥ï¼šéªŒè¯ä¿®å¤æ•ˆæœ
CHECK TABLE orders;
SELECT COUNT(*) FROM orders;  -- éªŒè¯è®°å½•æ•°
SELECT MAX(order_id) FROM orders;  -- éªŒè¯æ•°æ®å®Œæ•´æ€§

-- ç¬¬5æ­¥ï¼šæ€§èƒ½æµ‹è¯•
SELECT * FROM orders WHERE create_time > '2025-09-01' LIMIT 10;
-- ç¡®è®¤æŸ¥è¯¢é€Ÿåº¦æ­£å¸¸
```

## 10.2 æ¡ˆä¾‹ï¼šæ‰¹é‡è¡¨æŸåä¿®å¤



**ğŸ’¥ åœºæ™¯ï¼šæœåŠ¡å™¨å¼‚å¸¸æ–­ç”µå¯¼è‡´å¤šè¡¨æŸå**
```bash
# æ‰¹é‡æ£€æŸ¥è„šæœ¬

#!/bin/bash

# mass_repair.sh


echo "æ£€æŸ¥æ‰€æœ‰MyISAMè¡¨..."

mysql -e "
SELECT CONCAT('CHECK TABLE ', TABLE_SCHEMA, '.', TABLE_NAME, ';') as check_sql
FROM information_schema.TABLES 
WHERE ENGINE='MyISAM'
" -s -N > check_all.sql

# æ‰§è¡Œæ‰¹é‡æ£€æŸ¥

mysql < check_all.sql > check_results.txt

# åˆ†æç»“æœï¼Œæ‰¾å‡ºæŸåçš„è¡¨

grep -i "error\|warning\|crashed" check_results.txt > damaged_tables.txt

# æ‰¹é‡ä¿®å¤

cat damaged_tables.txt | while read line; do
    table_name=$(echo $line | cut -d'.' -f2 | cut -d' ' -f1)
    echo "ä¿®å¤è¡¨: $table_name"
    mysql -e "REPAIR TABLE $table_name EXTENDED"
done
```

## 10.3 æ¡ˆä¾‹ï¼šé¢„é˜²æ€§ç›‘æ§éƒ¨ç½²



**ğŸ“Š ç”Ÿäº§ç¯å¢ƒç›‘æ§éƒ¨ç½²**
```bash
# éƒ¨ç½²ç›‘æ§ç³»ç»Ÿ

setup_monitoring() {
#    # 1. åˆ›å»ºç›‘æ§æ•°æ®åº“
    mysql -e "CREATE DATABASE IF NOT EXISTS mysql_monitor"
    
#    # 2. åˆ›å»ºç›‘æ§è¡¨
    mysql mysql_monitor << EOF
CREATE TABLE health_reports (
    report_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    table_name VARCHAR(100),
    check_result VARCHAR(20),
    record_count BIGINT,
    data_size_mb DECIMAL(10,2),
    index_size_mb DECIMAL(10,2),
    fragmentation_pct DECIMAL(5,2)
);
EOF
    
#    # 3. é…ç½®å®šæ—¶ä»»åŠ¡
    cat >> /etc/crontab << EOF
# MyISAMå¥åº·æ£€æŸ¥

0 */4 * * * root /usr/local/bin/myisam_health_check.sh
0 2 * * * root /usr/local/bin/myisam_weekly_check.sh
0 3 1 * * root /usr/local/bin/myisam_monthly_maintenance.sh
EOF
}
```

---

# 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ æŸåæœ¬è´¨ï¼šMyISAMè¡¨æ–‡ä»¶çš„æ•°æ®ä¸ä¸€è‡´æˆ–ç»“æ„ç ´å
ğŸ”¸ æŸååˆ†ç±»ï¼šæŒ‰ä½ç½®ï¼ˆæ•°æ®/ç´¢å¼•/ç»“æ„ï¼‰ã€ç¨‹åº¦ï¼ˆè½»/ä¸­/é‡ï¼‰åˆ†ç±»
ğŸ”¸ æ£€æµ‹æ–¹æ³•ï¼šCHECK TABLEå‘½ä»¤å’Œmyisamchkå·¥å…·
ğŸ”¸ æ ¡éªŒå’Œæœºåˆ¶ï¼šé€šè¿‡æ•°å­¦ç®—æ³•éªŒè¯æ•°æ®å®Œæ•´æ€§
ğŸ”¸ ä¿®å¤ç­–ç•¥ï¼šåˆ†çº§ä¿®å¤ï¼Œä»å¿«é€Ÿåˆ°æ·±åº¦ä¿®å¤
ğŸ”¸ é¢„é˜²ä¸ºä¸»ï¼šå®šæœŸæ£€æŸ¥æ¯”å‡ºé—®é¢˜åä¿®å¤æ›´é‡è¦
```

## 11.2 å…³é”®æŠ€æœ¯è¦ç‚¹



**ğŸ”¹ æŸåæ£€æµ‹çš„æ ¸å¿ƒç†è§£**
```
æ£€æµ‹åŸç†ï¼š
â€¢ æ–‡ä»¶å®Œæ•´æ€§ï¼šæ£€æŸ¥æ–‡ä»¶å¤´å’Œç»“æ„
â€¢ æ•°æ®ä¸€è‡´æ€§ï¼šéªŒè¯è®°å½•æ ¼å¼å’Œå†…å®¹
â€¢ ç´¢å¼•æ­£ç¡®æ€§ï¼šç¡®ä¿ç´¢å¼•æŒ‡å‘æœ‰æ•ˆè®°å½•
â€¢ ç»Ÿè®¡å‡†ç¡®æ€§ï¼šè®°å½•æ•°é‡å’Œå¤§å°ç»Ÿè®¡

æ£€æµ‹ç­–ç•¥ï¼š
â€¢ å¿«é€Ÿæ£€æŸ¥ï¼šé€‚åˆé¢‘ç¹ç›‘æ§
â€¢ æ·±åº¦æ£€æŸ¥ï¼šé€‚åˆæ•…éšœè¯Šæ–­
â€¢ è‡ªåŠ¨æ£€æŸ¥ï¼šç»“åˆä¸šåŠ¡åœºæ™¯é…ç½®
```

**ğŸ”¹ æ ¡éªŒå’Œæœºåˆ¶çš„ä»·å€¼**
```
ä½œç”¨æœºåˆ¶ï¼š
â€¢ å†™å…¥æ—¶è®¡ç®—ï¼šä¸ºæ•°æ®ç”Ÿæˆ"æŒ‡çº¹"
â€¢ è¯»å–æ—¶éªŒè¯ï¼šæ£€æŸ¥"æŒ‡çº¹"æ˜¯å¦åŒ¹é…
â€¢ æŸåæ—¶æŠ¥è­¦ï¼šåŠæ—¶å‘ç°é—®é¢˜

æ€§èƒ½æƒè¡¡ï¼š
â€¢ å†™å…¥å¼€é”€ï¼šå¢åŠ 5-10%
â€¢ æ£€æŸ¥å¼€é”€ï¼šå¢åŠ 10-20%
â€¢ å®‰å…¨æ”¶ç›Šï¼šåŠæ—¶å‘ç°æŸåï¼Œé¿å…é”™è¯¯æ‰©æ•£
```

## 11.3 å®é™…åº”ç”¨æŒ‡å¯¼



**ğŸ› ï¸ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**
```
æ—¥å¸¸è¿ç»´ï¼š
â€¢ å»ºç«‹åˆ†å±‚æ£€æŸ¥åˆ¶åº¦ï¼ˆå¿«é€Ÿâ†’ä¸­ç­‰â†’æ·±åº¦ï¼‰
â€¢ é…ç½®è‡ªåŠ¨ä¿®å¤æœºåˆ¶ï¼ˆå…ˆå¤‡ä»½å†ä¿®å¤ï¼‰
â€¢ è®¾ç½®å¥åº·è¯„åˆ†å’Œå‘Šè­¦é˜ˆå€¼
â€¢ å®šæœŸåˆ†ææŸåæ¨¡å¼å’ŒåŸå› 

åº”æ€¥å¤„ç†ï¼š
â€¢ æŸåå‘ç°â†’ç«‹å³å¤‡ä»½â†’è¯„ä¼°ç¨‹åº¦â†’é€‰æ‹©ä¿®å¤æ–¹æ¡ˆ
â€¢ ä¿®å¤å¤±è´¥â†’ä»å¤‡ä»½æ¢å¤â†’åˆ†ææ ¹å› â†’æ”¹å–„é¢„é˜²
â€¢ å»ºç«‹åº”æ€¥å“åº”æµç¨‹å’Œè´£ä»»äººåˆ¶åº¦

é•¿æœŸè§„åˆ’ï¼š
â€¢ è¯„ä¼°MyISAMä½¿ç”¨çš„å¿…è¦æ€§
â€¢ è€ƒè™‘è¿ç§»åˆ°æ›´å¯é çš„å­˜å‚¨å¼•æ“
â€¢ æ”¹å–„ç¡¬ä»¶å’Œç¯å¢ƒæ¡ä»¶
â€¢ æå‡è¿ç»´è‡ªåŠ¨åŒ–æ°´å¹³
```

**âš–ï¸ æˆæœ¬æ•ˆç›Šåˆ†æ**
```
é¢„é˜²æˆæœ¬ï¼š
â€¢ ç›‘æ§ç³»ç»Ÿéƒ¨ç½²ï¼šä¸€æ¬¡æ€§æŠ•å…¥
â€¢ å®šæœŸæ£€æŸ¥æ—¶é—´ï¼šæ¯å¤©å‡ åˆ†é’Ÿ
â€¢ ç¡¬ä»¶æ”¹å–„æŠ•å…¥ï¼šä¸­ç­‰æŠ•å…¥

æŸåæˆæœ¬ï¼š
â€¢ æ•°æ®ä¸¢å¤±æŸå¤±ï¼šå¯èƒ½å·¨å¤§
â€¢ ä¸šåŠ¡ä¸­æ–­æŸå¤±ï¼šæ¯å°æ—¶æ•°ä¸‡
â€¢ ä¿®å¤æ—¶é—´æˆæœ¬ï¼šå‡ å°æ—¶åˆ°å‡ å¤©
â€¢ å®¢æˆ·ä¿¡ä»»æŸå¤±ï¼šéš¾ä»¥ä¼°é‡

ç»“è®ºï¼šé¢„é˜²çš„æŠ•å…¥è¿œå°äºæŸåçš„æŸå¤±
```

## 11.4 æŠ€æœ¯æ¼”è¿›è¶‹åŠ¿



**ğŸš€ å‘å±•æ–¹å‘**
```
æ£€æµ‹æŠ€æœ¯ï¼š
â€¢ æœºå™¨å­¦ä¹ é¢„æµ‹ï¼šåŸºäºå†å²æ¨¡å¼é¢„æµ‹é£é™©
â€¢ å®æ—¶ç›‘æ§ï¼šæµå¼æ•°æ®æ£€æµ‹å¼‚å¸¸
â€¢ æ™ºèƒ½ä¿®å¤ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ä¿®å¤ç­–ç•¥

å­˜å‚¨æŠ€æœ¯ï¼š
â€¢ å­˜å‚¨å¼•æ“è¿ç§»ï¼šä»MyISAMå‘InnoDBè¿ç§»
â€¢ åˆ†å¸ƒå¼å­˜å‚¨ï¼šå‡å°‘å•ç‚¹æ•…éšœé£é™©
â€¢ äº‘åŸç”Ÿæ–¹æ¡ˆï¼šåˆ©ç”¨äº‘å‚å•†çš„é«˜å¯ç”¨ç‰¹æ€§
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- MyISAMè™½å¿«ä½†è„†å¼±ï¼ŒæŸåæ£€æµ‹æ˜¯å¿…å¤‡æŠ€èƒ½
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œå®šæœŸæ£€æŸ¥å‘ç°é—®é¢˜æ—©
- æ ¡éªŒå’Œæ˜¯æ•°æ®å®ˆæŠ¤ç¥ï¼Œæ€§èƒ½æŸå¤±æ¢å®‰å…¨å€¼å¾—
- é£é™©è¯„ä¼°è¦å…¨é¢ï¼Œç¡¬ä»¶è½¯ä»¶ç¯å¢ƒäººä¸ºéƒ½è¦è€ƒè™‘