---
title: 5ã€ç®¡ç†è¿ç»´å·¥å…·
---
## ğŸ“š ç›®å½•

1. [è·¯ç”±ä¸è´Ÿè½½å‡è¡¡å·¥å…·](#1-è·¯ç”±ä¸è´Ÿè½½å‡è¡¡å·¥å…·)
2. [é«˜å¯ç”¨ç®¡ç†æ–¹æ¡ˆ](#2-é«˜å¯ç”¨ç®¡ç†æ–¹æ¡ˆ)
3. [é›†ç¾¤è§£å†³æ–¹æ¡ˆ](#3-é›†ç¾¤è§£å†³æ–¹æ¡ˆ)
4. [å®¹å™¨åŒ–éƒ¨ç½²å·¥å…·](#4-å®¹å™¨åŒ–éƒ¨ç½²å·¥å…·)
5. [è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·](#5-è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·)
6. [åŸºç¡€è®¾æ–½å³ä»£ç ](#6-åŸºç¡€è®¾æ–½å³ä»£ç )
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”€ è·¯ç”±ä¸è´Ÿè½½å‡è¡¡å·¥å…·


### 1.1 MySQL Routerè·¯ç”±å™¨


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
MySQL Routeræ˜¯ä»€ä¹ˆï¼š
MySQLå®˜æ–¹æä¾›çš„æ™ºèƒ½ä»£ç†å·¥å…·ï¼Œç›¸å½“äºMySQLçš„"äº¤é€šè­¦å¯Ÿ"
ä½œç”¨ï¼šå°†åº”ç”¨çš„æ•°æ®åº“è¯·æ±‚æ™ºèƒ½åˆ†å‘åˆ°ä¸åŒçš„MySQLæœåŠ¡å™¨
ä½ç½®ï¼šè¿è¡Œåœ¨åº”ç”¨æœåŠ¡å™¨å’ŒMySQLæœåŠ¡å™¨ä¹‹é—´
```

**ğŸ’¡ å·¥ä½œåŸç†å›¾ç¤º**
```
åº”ç”¨ç¨‹åº                MySQL Router                æ•°æ®åº“é›†ç¾¤
   |                        |                        |
   |--SQLè¯·æ±‚-------------->|                        |
   |                        |--è¯»è¯·æ±‚-------------->|ä¸»åº“(è¯»å†™)
   |                        |                        |
   |                        |--è¯»è¯·æ±‚-------------->|ä»åº“1(åªè¯»)
   |                        |                        |
   |                        |--è¯»è¯·æ±‚-------------->|ä»åº“2(åªè¯»)
   |<--ç»“æœè¿”å›-------------|<--æ•°æ®è¿”å›-------------|
```

**ğŸ”§ åŸºæœ¬é…ç½®ç¤ºä¾‹**
```ini
# mysqlrouter.conf
[DEFAULT]
user = mysqlrouter
connect_timeout = 30

# è¯»å†™åˆ†ç¦»è·¯ç”±
[routing:primary]
bind_address = 0.0.0.0
bind_port = 6446
destinations = 192.168.1.10:3306    # ä¸»åº“åœ°å€
routing_strategy = first-available

[routing:secondary] 
bind_address = 0.0.0.0
bind_port = 6447
destinations = 192.168.1.11:3306,192.168.1.12:3306  # ä»åº“åœ°å€
routing_strategy = round-robin       # è½®è¯¢è´Ÿè½½å‡è¡¡
```

**âš¡ æ ¸å¿ƒç‰¹æ€§**
- **ğŸ¯ è¯»å†™åˆ†ç¦»**ï¼šè‡ªåŠ¨å°†è¯»è¯·æ±‚å‘é€åˆ°ä»åº“ï¼Œå†™è¯·æ±‚å‘é€åˆ°ä¸»åº“
- **ğŸ“Š è´Ÿè½½å‡è¡¡**ï¼šæ”¯æŒè½®è¯¢ã€éšæœºç­‰å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥  
- **ğŸ”„ æ•…éšœè½¬ç§»**ï¼šä¸»åº“æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¯ç”¨èŠ‚ç‚¹
- **ğŸŒ é€æ˜ä»£ç†**ï¼šåº”ç”¨ç¨‹åºæ— éœ€ä¿®æ”¹ï¼Œç›´æ¥è¿æ¥Routerå³å¯

---

## 2. ğŸ›¡ï¸ é«˜å¯ç”¨ç®¡ç†æ–¹æ¡ˆ


### 2.1 MHAé«˜å¯ç”¨ç®¡ç†å™¨


**ğŸ”¸ MHAæ˜¯ä»€ä¹ˆ**
```
MHA (Master High Availability)ï¼šä¸“é—¨ä¸ºMySQLè®¾è®¡çš„é«˜å¯ç”¨ç®¡ç†å·¥å…·
æ ¸å¿ƒä½œç”¨ï¼šå½“MySQLä¸»åº“å‘ç”Ÿæ•…éšœæ—¶ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ä»åº“æå‡ä¸ºæ–°ä¸»åº“
è®¾è®¡ç†å¿µï¼šå°½å¯èƒ½å‡å°‘æ•…éšœåˆ‡æ¢æ—¶é—´ï¼Œé€šå¸¸åœ¨10-30ç§’å†…å®Œæˆ
```

**ğŸ—ï¸ MHAæ¶æ„ç»„æˆ**
```
MHAæ¶æ„å›¾ï¼š
        MHA Manager                    åº”ç”¨ç¨‹åº
     (ç›‘æ§å’Œæ•…éšœè½¬ç§»)                     |
            |                          |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”                  |
    |       |       |                  |
   ä¸»åº“  <- ä»åº“1 <- ä»åº“2              |
   (å†™)    (è¯»)    (è¯»)               VIPæ¼‚ç§»
    â†‘                                  â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€æ–°ä¸»åº“
```

**ğŸ’¡ MHAå·¥ä½œæµç¨‹**
```
æ­£å¸¸çŠ¶æ€ï¼š
1. MHA ManageræŒç»­ç›‘æ§ä¸»åº“çŠ¶æ€
2. åº”ç”¨é€šè¿‡VIPè¿æ¥ä¸»åº“è¿›è¡Œè¯»å†™æ“ä½œ
3. ä¸»åº“æ•°æ®å®æ—¶åŒæ­¥åˆ°ä»åº“

æ•…éšœåˆ‡æ¢ï¼š
1. MHAæ£€æµ‹åˆ°ä¸»åº“æ•…éšœï¼ˆé€šå¸¸3-10ç§’å†…ï¼‰
2. è‡ªåŠ¨é€‰æ‹©æ•°æ®æœ€æ–°çš„ä»åº“ä½œä¸ºæ–°ä¸»åº“
3. å°†å…¶ä»–ä»åº“é‡æ–°æŒ‡å‘æ–°ä¸»åº“
4. VIPæ¼‚ç§»åˆ°æ–°ä¸»åº“
5. åº”ç”¨è‡ªåŠ¨è¿æ¥æ–°ä¸»åº“ç»§ç»­æœåŠ¡
```

**ğŸ”§ MHAé…ç½®ç¤ºä¾‹**
```ini
# /etc/mha/app1.cnf
[server default]
user=mha
password=mha_pass
ssh_user=root
repl_user=repl
repl_password=repl_pass
ping_interval=3

[server1]
hostname=192.168.1.10
candidate_master=1

[server2]  
hostname=192.168.1.11
candidate_master=1

[server3]
hostname=192.168.1.12
no_master=1    # åªåšä»åº“ï¼Œä¸å‚ä¸ä¸»åº“é€‰ä¸¾
```

### 2.2 Keepalived VIPæ¼‚ç§»


**ğŸ”¸ VIPæ¼‚ç§»åŸç†**
```
VIP (Virtual IP)ï¼šè™šæ‹ŸIPåœ°å€ï¼Œåº”ç”¨ç¨‹åºè¿æ¥çš„ç»Ÿä¸€å…¥å£
æ¼‚ç§»æœºåˆ¶ï¼šå½“ä¸»åº“æ•…éšœæ—¶ï¼ŒVIPè‡ªåŠ¨"é£˜"åˆ°æ–°çš„ä¸»åº“æœåŠ¡å™¨ä¸Š
å¯¹åº”ç”¨é€æ˜ï¼šåº”ç”¨å§‹ç»ˆè¿æ¥åŒä¸€ä¸ªVIPï¼Œæ— éœ€ä¿®æ”¹é…ç½®
```

**ğŸ“¡ Keepalivedé…ç½®ç¤ºä¾‹**
```bash
# /etc/keepalived/keepalived.conf (ä¸»åº“æœåŠ¡å™¨)
vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 150        # ä¸»åº“ä¼˜å…ˆçº§é«˜
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.1.100   # VIPåœ°å€
    }
}

# ä»åº“æœåŠ¡å™¨é…ç½®ç±»ä¼¼ï¼Œä½†priorityè®¾ä¸º100
```

---

## 3. ğŸ˜ï¸ é›†ç¾¤è§£å†³æ–¹æ¡ˆ


### 3.1 MySQL InnoDB Clusteré›†ç¾¤


**ğŸ”¸ InnoDB Clusteræ˜¯ä»€ä¹ˆ**
```
å®šä¹‰ï¼šMySQLå®˜æ–¹æä¾›çš„å®Œæ•´é«˜å¯ç”¨é›†ç¾¤è§£å†³æ–¹æ¡ˆ
ç»„æˆï¼šMySQL Group Replication + MySQL Router + MySQL Shell
ç‰¹ç‚¹ï¼šåŸç”Ÿæ”¯æŒï¼Œé…ç½®ç›¸å¯¹ç®€å•ï¼Œé€‚åˆä¸­å°è§„æ¨¡éƒ¨ç½²
```

**ğŸ—ï¸ InnoDB Clusteræ¶æ„**
```
MySQL InnoDB Cluster æ¶æ„ï¼š

    MySQL Shell (ç®¡ç†å·¥å…·)
           |
    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
    |      |      |
   èŠ‚ç‚¹1  èŠ‚ç‚¹2  èŠ‚ç‚¹3      <- MySQL Group Replication
   (R/W)  (R)   (R)
    |      |      |
    â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
           |
    MySQL Router              <- æ™ºèƒ½è·¯ç”±
           |
       åº”ç”¨ç¨‹åº
```

**âš¡ Group Replicationæ ¸å¿ƒç‰¹æ€§**
- **ğŸ”„ åŒæ­¥å¤åˆ¶**ï¼šäº‹åŠ¡åœ¨å¤šä¸ªèŠ‚ç‚¹åŒæ—¶æäº¤ï¼Œæ•°æ®ä¸€è‡´æ€§æ›´å¼º
- **ğŸ“Š è‡ªåŠ¨æ•…éšœæ£€æµ‹**ï¼šèŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨ä»é›†ç¾¤ä¸­ç§»é™¤
- **ğŸ¯ è‡ªåŠ¨é€‰ä¸»**ï¼šä¸»èŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨é€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹
- **ğŸ“ˆ å¼¹æ€§æ‰©å±•**ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ å’Œç§»é™¤èŠ‚ç‚¹

**ğŸ”§ åˆ›å»ºInnoDB Clusterç¤ºä¾‹**
```javascript
// ä½¿ç”¨MySQL Shellåˆ›å»ºé›†ç¾¤
dba.createCluster('myCluster')

// æ·»åŠ èŠ‚ç‚¹åˆ°é›†ç¾¤
cluster = dba.getCluster()
cluster.addInstance('root@192.168.1.11:3306')
cluster.addInstance('root@192.168.1.12:3306')

// æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
cluster.status()
```

### 3.2 Galera Clusterå¤šä¸»é›†ç¾¤


**ğŸ”¸ Galera Clusterç‰¹ç‚¹**
```
æ ¸å¿ƒç†å¿µï¼šçœŸæ­£çš„å¤šä¸»æ¶æ„ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥è¯»å†™
æ•°æ®åŒæ­¥ï¼šåŸºäºwsrepåè®®çš„åŒæ­¥å¤åˆ¶
ä¸€è‡´æ€§ï¼šå¼ºä¸€è‡´æ€§ä¿è¯ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´é—®é¢˜
é€‚ç”¨åœºæ™¯ï¼šå¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯
```

**ğŸ”„ Galera vs ä¼ ç»Ÿä¸»ä»å¯¹æ¯”**
| ç‰¹æ€§ | **ä¼ ç»Ÿä¸»ä»** | **Galera Cluster** |
|-----|------------|-------------------|
| ğŸ—ï¸ **æ¶æ„** | `ä¸€ä¸»å¤šä»` | `å¤šä¸»å¤šå†™` |
| ğŸ“Š **ä¸€è‡´æ€§** | `æœ€ç»ˆä¸€è‡´` | `å¼ºä¸€è‡´æ€§` |
| âš¡ **å†™æ€§èƒ½** | `å•ç‚¹å†™å…¥` | `å¤šç‚¹å¹¶å‘å†™` |
| ğŸ”„ **æ•…éšœæ¢å¤** | `éœ€è¦æ‰‹åŠ¨åˆ‡æ¢` | `è‡ªåŠ¨æ•…éšœè½¬ç§»` |
| ğŸ’» **åº”ç”¨æ”¹é€ ** | `éœ€è¦è¯»å†™åˆ†ç¦»` | `æ— éœ€ç‰¹æ®Šå¤„ç†` |

---

## 4. ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²å·¥å…·


### 4.1 Dockerå®¹å™¨åŒ–éƒ¨ç½²


**ğŸ”¸ å®¹å™¨åŒ–çš„å¥½å¤„**
```
ç¯å¢ƒä¸€è‡´æ€§ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
å¿«é€Ÿéƒ¨ç½²ï¼šå‡ åˆ†é’Ÿå†…å¯åŠ¨å®Œæ•´çš„MySQLæœåŠ¡
èµ„æºéš”ç¦»ï¼šå®¹å™¨é—´äº’ä¸å¹²æ‰°ï¼Œæé«˜å®‰å…¨æ€§
ç‰ˆæœ¬ç®¡ç†ï¼šè½»æ¾åˆ‡æ¢å’Œå›æ»šMySQLç‰ˆæœ¬
```

**ğŸ“¦ Dockeréƒ¨ç½²MySQLç¤ºä¾‹**
```bash
# å•å®ä¾‹MySQLéƒ¨ç½²
docker run -d \
  --name mysql-server \
  -e MYSQL_ROOT_PASSWORD=password \
  -e MYSQL_DATABASE=myapp \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8.0

# ä¸»ä»å¤åˆ¶éƒ¨ç½²
docker-compose up -d
```

**ğŸ”§ docker-compose.ymlé…ç½®**
```yaml
version: '3.8'
services:
  mysql-master:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_REPLICATION_USER: replica
      MYSQL_REPLICATION_PASSWORD: replica
    volumes:
      - ./master.cnf:/etc/mysql/conf.d/mysql.cnf
      - master-data:/var/lib/mysql
    ports:
      - "3306:3306"
      
  mysql-slave:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: password
    volumes:
      - ./slave.cnf:/etc/mysql/conf.d/mysql.cnf
      - slave-data:/var/lib/mysql
    ports:
      - "3307:3306"
    depends_on:
      - mysql-master

volumes:
  master-data:
  slave-data:
```

### 4.2 Kubernetes Operator


**ğŸ”¸ MySQL Operatoræ¦‚å¿µ**
```
Kubernetes Operatorï¼šç”¨äºåœ¨K8sä¸­ç®¡ç†MySQLçš„ä¸“é—¨æ§åˆ¶å™¨
ä½œç”¨ï¼šå°†MySQLè¿ç»´ä¸“å®¶çš„çŸ¥è¯†ç¼–ç æˆè‡ªåŠ¨åŒ–ç¨‹åº
èƒ½åŠ›ï¼šè‡ªåŠ¨éƒ¨ç½²ã€å¤‡ä»½ã€æ•…éšœæ¢å¤ã€ç‰ˆæœ¬å‡çº§ç­‰
```

**â˜¸ï¸ MySQL Operatoræ¶æ„**
```
Kubernetesé›†ç¾¤æ¶æ„ï¼š

    kubectl (ç”¨æˆ·æ“ä½œ)
        |
    K8s API Server
        |
    MySQL Operator Controller
        |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
    |       |       |
   Pod1   Pod2   Pod3     <- MySQLå®ä¾‹Pod
    |       |       |
   PVC1   PVC2   PVC3     <- æŒä¹…åŒ–å­˜å‚¨
```

**âš¡ Operatoræ ¸å¿ƒåŠŸèƒ½**
- **ğŸš€ è‡ªåŠ¨éƒ¨ç½²**ï¼šä¸€é”®åˆ›å»ºMySQLé›†ç¾¤
- **ğŸ“ˆ å¼¹æ€§ä¼¸ç¼©**ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èŠ‚ç‚¹æ•°é‡
- **ğŸ”„ æ•…éšœè‡ªæ„ˆ**ï¼šèŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨é‡å»ºå’Œæ¢å¤
- **ğŸ“¦ ç‰ˆæœ¬ç®¡ç†**ï¼šæ— åœæœºå‡çº§MySQLç‰ˆæœ¬
- **ğŸ’¾ å¤‡ä»½ç®¡ç†**ï¼šå®šæ—¶å¤‡ä»½å’Œæ¢å¤

### 4.3 Helm Chartséƒ¨ç½²æ¨¡æ¿


**ğŸ”¸ Helm Chartsä½œç”¨**
```
Helmï¼šKubernetesçš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äºLinuxçš„yum/apt
Chartsï¼šé¢„å®šä¹‰çš„éƒ¨ç½²æ¨¡æ¿ï¼ŒåŒ…å«å®Œæ•´çš„MySQLéƒ¨ç½²é…ç½®
å¥½å¤„ï¼šæ ‡å‡†åŒ–éƒ¨ç½²ï¼Œé¿å…é‡å¤ç¼–å†™YAMLæ–‡ä»¶
```

**ğŸ“‹ Helméƒ¨ç½²MySQLç¤ºä¾‹**
```bash
# æ·»åŠ MySQL Helmä»“åº“
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# éƒ¨ç½²MySQLå•å®ä¾‹
helm install my-mysql bitnami/mysql \
  --set auth.rootPassword=password \
  --set primary.persistence.size=20Gi

# éƒ¨ç½²MySQLä¸»ä»æ¶æ„
helm install mysql-cluster bitnami/mysql \
  --set architecture=replication \
  --set secondary.replicaCount=2 \
  --set auth.rootPassword=password
```

---

## 5. ğŸ¤– è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·


### 5.1 Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²


**ğŸ”¸ Ansibleæ ¸å¿ƒæ¦‚å¿µ**
```
Ansibleï¼šåŸºäºPythonçš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·
å·¥ä½œæ–¹å¼ï¼šé€šè¿‡SSHè¿æ¥è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œä»»åŠ¡
ç‰¹ç‚¹ï¼šæ— éœ€åœ¨ç›®æ ‡æœåŠ¡å™¨å®‰è£…å®¢æˆ·ç«¯ï¼Œé…ç½®ç®€å•
ç”¨é€”ï¼šæ‰¹é‡éƒ¨ç½²ã€é…ç½®ç®¡ç†ã€åº”ç”¨å‘å¸ƒ
```

**ğŸ“ Ansible MySQLéƒ¨ç½²å‰§æœ¬**
```yaml
# mysql-deploy.yml
---
- name: Deploy MySQL Cluster
  hosts: mysql_servers
  become: yes
  vars:
    mysql_root_password: "{{ vault_mysql_password }}"
    mysql_version: "8.0"
  
  tasks:
    - name: Install MySQL Server
      yum:
        name: mysql-server
        state: present
    
    - name: Start MySQL Service  
      systemd:
        name: mysqld
        state: started
        enabled: yes
    
    - name: Configure MySQL
      template:
        src: my.cnf.j2
        dest: /etc/my.cnf
      notify: restart mysql
    
    - name: Create replication user
      mysql_user:
        name: repl
        password: "{{ repl_password }}"
        priv: "*.*:REPLICATION SLAVE"
        host: "%"
```

**ğŸš€ æ‰§è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²**
```bash
# æ‰§è¡ŒMySQLé›†ç¾¤éƒ¨ç½²
ansible-playbook -i inventory mysql-deploy.yml

# åªåœ¨ç‰¹å®šæœåŠ¡å™¨ç»„æ‰§è¡Œ
ansible-playbook -i inventory mysql-deploy.yml --limit mysql_masters
```

### 5.2 Puppeté…ç½®ç®¡ç†


**ğŸ”¸ Puppetå·¥ä½œåŸç†**
```
æ¶æ„ï¼šMaster-Agentæ¶æ„ï¼Œä¸­å¤®é…ç½®ç®¡ç†
å·¥ä½œæ–¹å¼ï¼šAgentå®šæœŸæ‹‰å–Masterä¸Šçš„é…ç½®å¹¶åº”ç”¨
ç‰¹ç‚¹ï¼šå£°æ˜å¼é…ç½®ï¼Œå¹‚ç­‰æ€§æ“ä½œ
é€‚ç”¨åœºæ™¯ï¼šå¤§è§„æ¨¡æœåŠ¡å™¨é…ç½®æ ‡å‡†åŒ–ç®¡ç†
```

**ğŸ”§ Puppet MySQLæ¨¡å—ç¤ºä¾‹**
```puppet
# mysql.pp
class mysql {
  package { 'mysql-server':
    ensure => installed,
  }
  
  service { 'mysqld':
    ensure     => running,
    enable     => true,
    require    => Package['mysql-server'],
  }
  
  file { '/etc/my.cnf':
    ensure  => present,
    content => template('mysql/my.cnf.erb'),
    notify  => Service['mysqld'],
  }
  
  mysql_user { 'app@%':
    ensure        => present,
    password_hash => mysql_password('app_password'),
    require       => Service['mysqld'],
  }
}
```

### 5.3 Chefè‡ªåŠ¨åŒ–é…ç½®


**ğŸ”¸ Chefæ ¸å¿ƒæ¦‚å¿µ**
```
Chefï¼šåŸºäºRubyçš„é…ç½®ç®¡ç†å·¥å…·
Cookbookï¼šåŒ…å«é…ç½®è„šæœ¬çš„é›†åˆï¼Œç±»ä¼¼äºè½¯ä»¶åŒ…
Recipeï¼šå…·ä½“çš„é…ç½®æ­¥éª¤ï¼Œç”¨Ruby DSLç¼–å†™
Nodeï¼šè¢«ç®¡ç†çš„æœåŠ¡å™¨èŠ‚ç‚¹
```

**ğŸ‘¨â€ğŸ³ Chef MySQL Cookbookç¤ºä¾‹**
```ruby
# recipes/default.rb
package 'mysql-server' do
  action :install
end

service 'mysqld' do
  action [:enable, :start]
end

template '/etc/my.cnf' do
  source 'my.cnf.erb'
  variables({
    :server_id => node['mysql']['server_id'],
    :binlog_format => 'ROW'
  })
  notifies :restart, 'service[mysqld]'
end

mysql_database 'myapp' do
  connection mysql_connection_info
  action :create
end
```

### 5.4 Saltè‡ªåŠ¨åŒ–è¿ç»´


**ğŸ”¸ Saltç‰¹ç‚¹**
```
Saltï¼šåŸºäºZeroMQçš„é«˜æ€§èƒ½è‡ªåŠ¨åŒ–å·¥å…·
é€šä¿¡æ–¹å¼ï¼šå¼‚æ­¥æ¶ˆæ¯ä¼ é€’ï¼Œæ”¯æŒå¤§è§„æ¨¡å¹¶å‘
æ‰§è¡Œé€Ÿåº¦ï¼šæ¯”Ansibleç­‰å·¥å…·å¿«10å€ä»¥ä¸Š
é…ç½®è¯­è¨€ï¼šYAMLæ ¼å¼ï¼Œç®€å•æ˜“è¯»
```

**ğŸ§‚ Salt MySQLçŠ¶æ€æ–‡ä»¶**
```yaml
# mysql.sls
mysql-server:
  pkg.installed: []
  service.running:
    - enable: True
    - require:
      - pkg: mysql-server

/etc/my.cnf:
  file.managed:
    - source: salt://mysql/my.cnf
    - template: jinja
    - context:
        server_id: {{ grains['id'] }}
    - require:
      - pkg: mysql-server
    - watch_in:
      - service: mysql-server

mysql_root_password:
  mysql_user.present:
    - name: root
    - password: {{ pillar['mysql_root_password'] }}
    - host: localhost
```

---

## 6. ğŸ—ï¸ åŸºç¡€è®¾æ–½å³ä»£ç 


### 6.1 TerraformåŸºç¡€è®¾æ–½ä»£ç 


**ğŸ”¸ Terraformæ ¸å¿ƒç†å¿µ**
```
åŸºç¡€è®¾æ–½å³ä»£ç  (Infrastructure as Code)ï¼š
ç”¨ä»£ç æè¿°å’Œç®¡ç†åŸºç¡€è®¾æ–½èµ„æº
å¥½å¤„ï¼šç‰ˆæœ¬æ§åˆ¶ã€å¯é‡å¤éƒ¨ç½²ã€æ ‡å‡†åŒ–ç®¡ç†
æ”¯æŒå¹³å°ï¼šAWSã€Azureã€é˜¿é‡Œäº‘ã€VMwareç­‰
```

**â˜ï¸ Terraform MySQLéƒ¨ç½²ç¤ºä¾‹**
```hcl
# main.tf
provider "aws" {
  region = "us-west-2"
}

# åˆ›å»ºVPCå’Œå­ç½‘
resource "aws_vpc" "mysql_vpc" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true
  
  tags = {
    Name = "mysql-vpc"
  }
}

resource "aws_subnet" "mysql_subnet" {
  count             = 2
  vpc_id            = aws_vpc.mysql_vpc.id
  cidr_block        = "10.0.${count.index + 1}.0/24"
  availability_zone = data.aws_availability_zones.available.names[count.index]
  
  tags = {
    Name = "mysql-subnet-${count.index + 1}"
  }
}

# RDS MySQLå®ä¾‹
resource "aws_db_instance" "mysql" {
  identifier = "mysql-${var.environment}"
  
  engine         = "mysql"
  engine_version = "8.0"
  instance_class = var.db_instance_class
  
  allocated_storage     = var.db_storage
  max_allocated_storage = var.db_max_storage
  
  db_name  = var.db_name
  username = var.db_username
  password = var.db_password
  
  vpc_security_group_ids = [aws_security_group.mysql.id]
  db_subnet_group_name   = aws_db_subnet_group.mysql.name
  
  backup_retention_period = 7
  backup_window          = "03:00-04:00"
  maintenance_window     = "sun:04:00-sun:05:00"
  
  skip_final_snapshot = false
  final_snapshot_identifier = "mysql-${var.environment}-final-snapshot"
  
  tags = {
    Name        = "mysql-${var.environment}"
    Environment = var.environment
  }
}
```

**ğŸ”§ æ‰§è¡ŒTerraforméƒ¨ç½²**
```bash
# åˆå§‹åŒ–Terraform
terraform init

# æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
terraform plan -var-file="prod.tfvars"

# åº”ç”¨é…ç½®ï¼Œåˆ›å»ºèµ„æº
terraform apply -var-file="prod.tfvars"

# é”€æ¯èµ„æº
terraform destroy -var-file="prod.tfvars"
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è·¯ç”±å·¥å…·ï¼šMySQL Routerå®ç°è¯»å†™åˆ†ç¦»å’Œè´Ÿè½½å‡è¡¡
ğŸ”¸ é«˜å¯ç”¨æ–¹æ¡ˆï¼šMHA+Keepalivedç¡®ä¿æ•…éšœå¿«é€Ÿåˆ‡æ¢
ğŸ”¸ é›†ç¾¤æ–¹æ¡ˆï¼šInnoDB Clusterå’ŒGaleraæä¾›ä¸åŒçº§åˆ«çš„é«˜å¯ç”¨
ğŸ”¸ å®¹å™¨åŒ–ï¼šDockerå’ŒK8s Operatorç®€åŒ–éƒ¨ç½²å’Œç®¡ç†
ğŸ”¸ è‡ªåŠ¨åŒ–è¿ç»´ï¼šAnsibleã€Puppetç­‰å·¥å…·å®ç°æ‰¹é‡ç®¡ç†
ğŸ”¸ åŸºç¡€è®¾æ–½å³ä»£ç ï¼šTerraformå®ç°æ ‡å‡†åŒ–èµ„æºç®¡ç†
```

### 7.2 å·¥å…·é€‰æ‹©æŒ‡å¯¼åŸåˆ™


**ğŸ”¹ æ ¹æ®è§„æ¨¡é€‰æ‹©**
```
å°å‹é¡¹ç›® (< 10å°)ï¼š
â†’ Docker + docker-compose
â†’ ç®€å•çš„ä¸»ä»å¤åˆ¶ + Keepalived

ä¸­å‹é¡¹ç›® (10-100å°)ï¼š
â†’ MySQL InnoDB Cluster + MySQL Router
â†’ Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²
â†’ Kubernetes + MySQL Operator

å¤§å‹é¡¹ç›® (> 100å°)ï¼š
â†’ Galera Cluster + HAProxy
â†’ Terraform + Ansibleç»„åˆ
â†’ å®Œæ•´çš„DevOpså·¥å…·é“¾
```

**ğŸ”¹ æ ¹æ®éœ€æ±‚é€‰æ‹©**
```
é«˜å¯ç”¨éœ€æ±‚ï¼š
ğŸš¨ è¦æ±‚æé«˜ â†’ Galera Clusterå¤šä¸»æ¶æ„
ğŸ“ˆ è¦æ±‚è¾ƒé«˜ â†’ InnoDB Cluster + MHA
âš¡ä¸€èˆ¬è¦æ±‚ â†’ ä¼ ç»Ÿä¸»ä» + Keepalived

è¿ç»´å¤æ‚åº¦ï¼š
ğŸ”§ è¿½æ±‚ç®€å• â†’ Dockerå®¹å™¨åŒ–éƒ¨ç½²
ğŸ“Š æ ‡å‡†ç®¡ç† â†’ Kubernetes + Operator
ğŸ¯ ç²¾ç»†æ§åˆ¶ â†’ ä¼ ç»Ÿéƒ¨ç½² + è‡ªåŠ¨åŒ–å·¥å…·
```

### 7.3 æœ€ä½³å®è·µå»ºè®®


**âš¡ éƒ¨ç½²æœ€ä½³å®è·µ**
- **ğŸ¯ æ¸è¿›å¼å‡çº§**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œå†é€æ­¥æ¨å¹¿åˆ°ç”Ÿäº§
- **ğŸ“¦ ç‰ˆæœ¬ç»Ÿä¸€**ï¼šæ‰€æœ‰ç¯å¢ƒä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„MySQLå’Œå·¥å…·
- **ğŸ”„ é…ç½®æ ‡å‡†åŒ–**ï¼šä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·ç¡®ä¿é…ç½®ä¸€è‡´æ€§
- **ğŸ“Š ç›‘æ§è¦†ç›–**ï¼šéƒ¨ç½²å®Œæˆåç«‹å³é…ç½®ç›‘æ§å’Œå‘Šè­¦

**ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ**
- **ğŸ” å¯†ç ç®¡ç†**ï¼šä½¿ç”¨Vaultç­‰å·¥å…·ç®¡ç†æ•°æ®åº“å¯†ç 
- **ğŸŒ ç½‘ç»œéš”ç¦»**ï¼šæ•°æ®åº“æœåŠ¡å™¨æ”¾åœ¨ç‹¬ç«‹çš„å®‰å…¨ç»„
- **ğŸ“ æƒé™æ§åˆ¶**ï¼šéµå¾ªæœ€å°æƒé™åŸåˆ™é…ç½®æ•°æ®åº“ç”¨æˆ·
- **ğŸ” å®¡è®¡æ—¥å¿—**ï¼šå¯ç”¨æ“ä½œå®¡è®¡ï¼Œè®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ

**æ ¸å¿ƒè®°å¿†**ï¼š
- å·¥å…·æ˜¯ä¸ºäº†è§£å†³é—®é¢˜ï¼Œä¸æ˜¯ä¸ºäº†ç‚«æŠ€
- é€‰æ‹©åˆé€‚çš„å·¥å…·æ¯”ä½¿ç”¨æœ€æ–°çš„å·¥å…·æ›´é‡è¦  
- è‡ªåŠ¨åŒ–å¯ä»¥å‡å°‘äººä¸ºé”™è¯¯ï¼Œä½†éœ€è¦å……åˆ†æµ‹è¯•
- é«˜å¯ç”¨ä¸ç­‰äºé«˜æ€§èƒ½ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘