---
title: 13ã€pt-variable-advisorå˜é‡å»ºè®®å·¥å…·
---
## ğŸ“š ç›®å½•

1. [pt-variable-advisorå·¥å…·æ¦‚è¿°](#1-pt-variable-advisorå·¥å…·æ¦‚è¿°)
2. [ç³»ç»Ÿå˜é‡åˆ†æä¸æ£€æŸ¥](#2-ç³»ç»Ÿå˜é‡åˆ†æä¸æ£€æŸ¥)
3. [é…ç½®ä¼˜åŒ–å»ºè®®æœºåˆ¶](#3-é…ç½®ä¼˜åŒ–å»ºè®®æœºåˆ¶)
4. [å‚æ•°å®‰å…¨æ£€æŸ¥ä¸é£é™©è¯„ä¼°](#4-å‚æ•°å®‰å…¨æ£€æŸ¥ä¸é£é™©è¯„ä¼°)
5. [åŠ¨æ€å‚æ•°è°ƒä¼˜å®è·µ](#5-åŠ¨æ€å‚æ•°è°ƒä¼˜å®è·µ)
6. [é…ç½®æ¨¡æ¿åº“ä¸æœ€ä½³å®è·µ](#6-é…ç½®æ¨¡æ¿åº“ä¸æœ€ä½³å®è·µ)
7. [å‚æ•°ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†](#7-å‚æ•°ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” pt-variable-advisorå·¥å…·æ¦‚è¿°


### 1.1 å·¥å…·å®šä¹‰ä¸ä½œç”¨


**ğŸ¯ ä»€ä¹ˆæ˜¯pt-variable-advisor**
```
ç®€å•ç†è§£ï¼šMySQLé…ç½®å‚æ•°çš„"ä½“æ£€åŒ»ç”Ÿ"
ä½œç”¨ï¼šæ£€æŸ¥ä½ çš„MySQLé…ç½®æ˜¯å¦åˆç†ï¼Œç»™å‡ºä¸“ä¸šçš„ä¼˜åŒ–å»ºè®®
å¥½å¤„ï¼šé¿å…é…ç½®é”™è¯¯å¯¼è‡´çš„æ€§èƒ½é—®é¢˜å’Œå®‰å…¨é£é™©
```

**ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½è§£é‡Š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pt-variable-advisorçš„å·¥ä½œæµç¨‹   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è¯»å–å½“å‰MySQLé…ç½®å‚æ•°        â”‚
â”‚ 2. å¯¹æ¯”æœ€ä½³å®è·µå’Œå®‰å…¨æ ‡å‡†       â”‚
â”‚ 3. è¯†åˆ«æ½œåœ¨çš„é—®é¢˜å’Œé£é™©         â”‚
â”‚ 4. ç»™å‡ºå…·ä½“çš„ä¼˜åŒ–å»ºè®®           â”‚
â”‚ 5. æä¾›å‚æ•°è°ƒæ•´çš„å…·ä½“æ–¹æ¡ˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå·¥å…·


**ğŸš¨ å¸¸è§é…ç½®é—®é¢˜**
```
å®é™…åœºæ™¯ä¸¾ä¾‹ï¼š

é—®é¢˜1ï¼šç¼“å†²æ± é…ç½®è¿‡å°
- ç°è±¡ï¼šæŸ¥è¯¢é€Ÿåº¦å¾ˆæ…¢ï¼Œç£ç›˜IOå¾ˆé«˜
- åŸå› ï¼šinnodb_buffer_pool_sizeè®¾ç½®å¤ªå°
- åæœï¼šæ•°æ®æ— æ³•ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œé¢‘ç¹è¯»å–ç£ç›˜

é—®é¢˜2ï¼šè¿æ¥æ•°é…ç½®ä¸å½“  
- ç°è±¡ï¼šåº”ç”¨é¢‘ç¹æŠ¥"è¿æ¥æ•°è¿‡å¤š"é”™è¯¯
- åŸå› ï¼šmax_connectionsè®¾ç½®è¿‡ä½
- åæœï¼šç”¨æˆ·æ— æ³•æ­£å¸¸è®¿é—®æ•°æ®åº“

é—®é¢˜3ï¼šæ—¥å¿—é…ç½®æœ‰å®‰å…¨éšæ‚£
- ç°è±¡ï¼šæ•æ„Ÿä¿¡æ¯è¢«è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶
- åŸå› ï¼šlog_bin_trust_function_creators = ON
- åæœï¼šå¯èƒ½æ³„éœ²ä¸šåŠ¡æ•æ„Ÿæ•°æ®
```

> ğŸ’¡ **æ ¸å¿ƒä»·å€¼**ï¼špt-variable-advisorå°±åƒä¸€ä¸ªç»éªŒä¸°å¯Œçš„DBAï¼Œå¸®ä½ æå‰å‘ç°è¿™äº›é—®é¢˜

### 1.3 å·¥å…·çš„åŸºæœ¬ä½¿ç”¨


**ğŸ“‹ åŸºç¡€å‘½ä»¤æ ¼å¼**
```bash
# åŸºæœ¬è¯­æ³•
pt-variable-advisor [é€‰é¡¹] [æ•°æ®æº]

# æœ€ç®€å•çš„ç”¨æ³• - æ£€æŸ¥æœ¬åœ°MySQL
pt-variable-advisor

# æ£€æŸ¥è¿œç¨‹MySQLæœåŠ¡å™¨
pt-variable-advisor h=192.168.1.100,u=root,p=password
```

**ğŸ”§ å¸¸ç”¨å‚æ•°è¯´æ˜**
```bash
--source-of-variables    # æŒ‡å®šå˜é‡æ¥æº
--ignore-rules          # å¿½ç•¥ç‰¹å®šè§„åˆ™
--report-format         # è¾“å‡ºæŠ¥å‘Šæ ¼å¼
--output-file          # å°†ç»“æœä¿å­˜åˆ°æ–‡ä»¶
```

---

## 2. ğŸ“Š ç³»ç»Ÿå˜é‡åˆ†æä¸æ£€æŸ¥


### 2.1 å˜é‡åˆ†æçš„å·¥ä½œåŸç†


**ğŸ” åˆ†ææœºåˆ¶è¯¦è§£**
```
pt-variable-advisorçš„æ£€æŸ¥é€»è¾‘ï¼š

æ­¥éª¤1ï¼šæ”¶é›†ç³»ç»Ÿå˜é‡
â”œâ”€ ä»SHOW VARIABLESè·å–å½“å‰é…ç½®
â”œâ”€ ä»é…ç½®æ–‡ä»¶è¯»å–é™æ€å‚æ•°
â””â”€ è¯†åˆ«åŠ¨æ€å¯è°ƒæ•´çš„å‚æ•°

æ­¥éª¤2ï¼šè§„åˆ™åŒ¹é…åˆ†æ
â”œâ”€ å¯¹æ¯”å†…ç½®çš„æœ€ä½³å®è·µè§„åˆ™
â”œâ”€ æ£€æŸ¥å‚æ•°ä¹‹é—´çš„ä¾èµ–å…³ç³»
â””â”€ è¯„ä¼°å‚æ•°å¯¹æ€§èƒ½çš„å½±å“

æ­¥éª¤3ï¼šç”Ÿæˆåˆ†ææŠ¥å‘Š
â”œâ”€ æ ‡è¯†æœ‰é—®é¢˜çš„é…ç½®
â”œâ”€ è®¡ç®—é£é™©ç­‰çº§
â””â”€ æä¾›å…·ä½“çš„ä¿®æ”¹å»ºè®®
```

### 2.2 æ ¸å¿ƒå˜é‡ç±»åˆ«åˆ†æ


**âš¡ æ€§èƒ½ç›¸å…³å˜é‡**
```bash
# æ£€æŸ¥å†…å­˜é…ç½®ç›¸å…³å˜é‡
pt-variable-advisor --source-of-variables mysql \
  --report-format tabular

å¸¸æ£€æŸ¥çš„æ€§èƒ½å˜é‡ï¼š
â”œâ”€ innodb_buffer_pool_size     # InnoDBç¼“å†²æ± å¤§å°
â”œâ”€ key_buffer_size             # MyISAMç´¢å¼•ç¼“å­˜
â”œâ”€ sort_buffer_size            # æ’åºç¼“å†²åŒºå¤§å°
â”œâ”€ read_buffer_size            # é¡ºåºè¯»ç¼“å†²åŒº
â””â”€ thread_cache_size           # çº¿ç¨‹ç¼“å­˜æ•°é‡
```

**ğŸ”’ å®‰å…¨ç›¸å…³å˜é‡**
```bash
# ä¸“é—¨æ£€æŸ¥å®‰å…¨é…ç½®
pt-variable-advisor --ignore-rules "" \
  | grep -E "(security|password|ssl)"

å®‰å…¨å˜é‡ç¤ºä¾‹ï¼š
â”œâ”€ validate_password_policy    # å¯†ç å¤æ‚åº¦ç­–ç•¥
â”œâ”€ ssl_cipher                  # SSLåŠ å¯†ç®—æ³•
â”œâ”€ local_infile               # æœ¬åœ°æ–‡ä»¶å¯¼å…¥æƒé™
â””â”€ secure_file_priv           # æ–‡ä»¶æ“ä½œé™åˆ¶ç›®å½•
```

### 2.3 å˜é‡ä¾èµ–å…³ç³»åˆ†æ


**ğŸ”— å‚æ•°ä¾èµ–æ£€æŸ¥**
```
ç†è§£å‚æ•°é—´çš„å…³ç³»å¾ˆé‡è¦ï¼š

ä¾èµ–å…³ç³»ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»è¦å‚æ•°      â”‚      ä¾èµ–å‚æ•°        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ innodb_buffer   â”‚ â†’ innodb_log_file_   â”‚
â”‚ _pool_size      â”‚   size (å»ºè®®1/4å¤§å°) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ max_connections â”‚ â†’ thread_cache_size  â”‚
â”‚                 â”‚   (å»ºè®®connections/3)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ query_cache_sizeâ”‚ â†’ query_cache_type   â”‚
â”‚                 â”‚   (å¿…é¡»å¯ç”¨æ‰æœ‰æ•ˆ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“‹ å®é™…æ£€æŸ¥ç¤ºä¾‹**
```bash
# æ£€æŸ¥ç¼“å†²åŒºé…ç½®çš„åè°ƒæ€§
mysql> SHOW VARIABLES LIKE '%buffer%';

# pt-variable-advisorä¼šæ£€æŸ¥è¿™äº›é…ç½®æ˜¯å¦åˆç†ï¼š
# - æ€»å†…å­˜ä½¿ç”¨æ˜¯å¦è¶…è¿‡ç³»ç»Ÿå¯ç”¨å†…å­˜
# - å„ä¸ªç¼“å†²åŒºçš„æ¯”ä¾‹æ˜¯å¦æ°å½“
# - æ˜¯å¦å­˜åœ¨é…ç½®å†²çª
```

---

## 3. ğŸ¯ é…ç½®ä¼˜åŒ–å»ºè®®æœºåˆ¶


### 3.1 ä¼˜åŒ–å»ºè®®çš„ç”Ÿæˆé€»è¾‘


**ğŸ§  å»ºè®®ç”Ÿæˆç®—æ³•**
```
pt-variable-advisorå¦‚ä½•ç»™å‡ºå»ºè®®ï¼š

åˆ†æç»´åº¦ï¼š
1ï¸âƒ£ ç¡¬ä»¶èµ„æºè¯„ä¼°
   â”œâ”€ ç³»ç»Ÿæ€»å†…å­˜å¤§å°
   â”œâ”€ CPUæ ¸å¿ƒæ•°é‡
   â””â”€ ç£ç›˜IOæ€§èƒ½

2ï¸âƒ£ ä¸šåŠ¡è´Ÿè½½æ¨¡å¼
   â”œâ”€ è¿æ¥æ•°ä½¿ç”¨æƒ…å†µ
   â”œâ”€ æŸ¥è¯¢å¤æ‚åº¦åˆ†æ
   â””â”€ è¯»å†™æ¯”ä¾‹è¯„ä¼°

3ï¸âƒ£ ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
   â”œâ”€ MySQLç‰ˆæœ¬ç‰¹æ€§æ”¯æŒ
   â”œâ”€ å·²åºŸå¼ƒå‚æ•°è¯†åˆ«
   â””â”€ æ–°ç‰¹æ€§æ¨èä½¿ç”¨
```

### 3.2 æ€§èƒ½è°ƒä¼˜å»ºè®®è¯¦è§£


**ğŸ“ˆ å†…å­˜ä¼˜åŒ–å»ºè®®**
```bash
# å…¸å‹çš„å†…å­˜ä¼˜åŒ–å»ºè®®è¾“å‡º
pt-variable-advisor h=localhost

# å¯èƒ½çš„å»ºè®®å†…å®¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WARN innodb_buffer_pool_size           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½“å‰å€¼: 128M                           â”‚
â”‚ å»ºè®®å€¼: 2G-4G                          â”‚
â”‚ åŸå› : ç³»ç»Ÿæœ‰8GBå†…å­˜ï¼Œç¼“å†²æ± è¿‡å°        â”‚
â”‚ å½±å“: é¢‘ç¹ç£ç›˜IOï¼ŒæŸ¥è¯¢æ€§èƒ½å·®           â”‚
â”‚ ä¿®æ”¹: SET innodb_buffer_pool_size=2G;  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš¡ å¹¶å‘ä¼˜åŒ–å»ºè®®**
```bash
# è¿æ¥å’Œçº¿ç¨‹ç›¸å…³çš„ä¼˜åŒ–å»ºè®®
å»ºè®®ç±»å‹ç¤ºä¾‹ï¼š

é«˜å¹¶å‘åœºæ™¯å»ºè®®ï¼š
â”œâ”€ max_connections = 500 â†’ 1000
â”‚  ç†ç”±ï¼šå½“å‰è¿æ¥ç»å¸¸è¾¾åˆ°ä¸Šé™
â”œâ”€ thread_cache_size = 8 â†’ 100  
â”‚  ç†ç”±ï¼šé¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹ï¼ŒCPUå¼€é”€å¤§
â””â”€ back_log = 50 â†’ 200
   ç†ç”±ï¼šè¿æ¥é˜Ÿåˆ—ç»å¸¸æ»¡ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿
```

### 3.3 è‡ªåŠ¨åŒ–é…ç½®ç”Ÿæˆ


**ğŸ”§ é…ç½®æ¨¡æ¿ç”Ÿæˆ**
```bash
# ç”Ÿæˆä¼˜åŒ–åçš„é…ç½®æ–‡ä»¶
pt-variable-advisor --source-of-variables mysql \
  --output-file /tmp/mysql_optimized.cnf

# è¾“å‡ºç¤ºä¾‹é…ç½®
[mysqld]
# å†…å­˜é…ç½®ä¼˜åŒ–
innodb_buffer_pool_size = 4G
key_buffer_size = 256M
sort_buffer_size = 2M

# è¿æ¥é…ç½®ä¼˜åŒ–  
max_connections = 800
thread_cache_size = 200
wait_timeout = 28800

# æ—¥å¿—é…ç½®ä¼˜åŒ–
innodb_log_file_size = 1G
binlog_cache_size = 32K
```

---

## 4. ğŸ›¡ï¸ å‚æ•°å®‰å…¨æ£€æŸ¥ä¸é£é™©è¯„ä¼°


### 4.1 å®‰å…¨é£é™©è¯†åˆ«æœºåˆ¶


**ğŸš¨ å¸¸è§å®‰å…¨é£é™©ç±»å‹**
```
pt-variable-advisoræ£€æŸ¥çš„å®‰å…¨é—®é¢˜ï¼š

é«˜é£é™©é…ç½®ï¼š
ğŸ”´ local_infile = ON
   é£é™©ï¼šå…è®¸å®¢æˆ·ç«¯è¯»å–æœåŠ¡å™¨æ–‡ä»¶ï¼Œå¯èƒ½è¢«æ¶æ„åˆ©ç”¨
   å»ºè®®ï¼šè®¾ç½®ä¸ºOFFï¼Œç¦ç”¨æœ¬åœ°æ–‡ä»¶å¯¼å…¥

ğŸ”´ secure_file_priv = ""  
   é£é™©ï¼šå¯åœ¨ä»»æ„ç›®å½•è¯»å†™æ–‡ä»¶ï¼Œå­˜åœ¨æ•°æ®æ³„éœ²é£é™©
   å»ºè®®ï¼šæŒ‡å®šå®‰å…¨ç›®å½•ï¼Œå¦‚ /var/lib/mysql-files/

ğŸ”´ old_passwords = 1
   é£é™©ï¼šä½¿ç”¨è¿‡æ—¶çš„å¯†ç å“ˆå¸Œç®—æ³•ï¼Œæ˜“è¢«ç ´è§£
   å»ºè®®ï¼šå‡çº§åˆ°æ›´å®‰å…¨çš„å“ˆå¸Œæ–¹å¼
```

### 4.2 é…ç½®é£é™©è¯„ä¼°ç­‰çº§


**ğŸ“Š é£é™©ç­‰çº§åˆ†ç±»**
```
é£é™©è¯„ä¼°æ ‡å‡†ï¼š

ğŸ”´ ä¸¥é‡é£é™© (Critical)
â”œâ”€ å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²
â”œâ”€ æœåŠ¡å™¨è¢«å…¥ä¾µçš„é£é™©
â””â”€ æ•°æ®å®Œæ•´æ€§å—å¨èƒ

ğŸŸ¡ ä¸­ç­‰é£é™© (Warning)  
â”œâ”€ æ€§èƒ½æ˜¾è‘—ä¸‹é™
â”œâ”€ èµ„æºæµªè´¹ä¸¥é‡
â””â”€ å½±å“ä¸šåŠ¡ç¨³å®šæ€§

ğŸŸ¢ ä½é£é™© (Notice)
â”œâ”€ é…ç½®ä¸æ˜¯æœ€ä¼˜
â”œâ”€ å­˜åœ¨æ”¹è¿›ç©ºé—´
â””â”€ å»ºè®®ä½†éå¿…é¡»
```

**ğŸ” å®é™…é£é™©æ£€æŸ¥ç¤ºä¾‹**
```bash
# ä¸“é—¨æ£€æŸ¥å®‰å…¨ç›¸å…³é…ç½®
pt-variable-advisor --ignore-rules "warn,notice" 

# è¾“å‡ºå¯èƒ½åŒ…å«ï¼š
WARNING: validate_password_policy is OFF
  - å¯†ç ç­–ç•¥æœªå¯ç”¨ï¼Œå­˜åœ¨å¼±å¯†ç é£é™©
  - å»ºè®®å¼€å¯å¯†ç å¤æ‚åº¦éªŒè¯

CRITICAL: ssl_ca is empty  
  - SSLè¯ä¹¦é…ç½®ç¼ºå¤±ï¼Œæ•°æ®ä¼ è¾“ä¸å®‰å…¨
  - å»ºè®®é…ç½®SSLè¯ä¹¦åŠ å¯†é€šä¿¡
```

### 4.3 å‚æ•°å½±å“åˆ†æ


**ğŸ“‹ å½±å“è¯„ä¼°æŠ¥å‘Š**
```bash
# åˆ†æå‚æ•°å˜æ›´çš„æ½œåœ¨å½±å“
æ¯ä¸ªå»ºè®®éƒ½ä¼šåŒ…å«å½±å“åˆ†æï¼š

å‚æ•°: max_connections
â”œâ”€ å½“å‰å€¼: 151
â”œâ”€ å»ºè®®å€¼: 500  
â”œâ”€ å½±å“åˆ†æ:
â”‚  â”œâ”€ å†…å­˜å½±å“: å¢åŠ çº¦350MBå†…å­˜ä½¿ç”¨
â”‚  â”œâ”€ æ€§èƒ½å½±å“: æå‡å¹¶å‘å¤„ç†èƒ½åŠ›
â”‚  â”œâ”€ é£é™©è¯„ä¼°: å†…å­˜ä¸è¶³æ—¶å¯èƒ½å½±å“ç¨³å®šæ€§
â”‚  â””â”€ å»ºè®®æ—¶æœº: ä¸šåŠ¡ä½å³°æœŸä¿®æ”¹
â””â”€ å›æ»šæ–¹æ¡ˆ: SET max_connections=151;
```

---

## 5. âš™ï¸ åŠ¨æ€å‚æ•°è°ƒä¼˜å®è·µ


### 5.1 åŠ¨æ€å‚æ•°è¯†åˆ«ä¸è°ƒæ•´


**ğŸ”„ åŠ¨æ€vsé™æ€å‚æ•°**
```
å‚æ•°ç±»å‹ç†è§£ï¼š

åŠ¨æ€å‚æ•°ï¼ˆå¯åœ¨çº¿è°ƒæ•´ï¼‰ï¼š
âœ… max_connections          # æœ€å¤§è¿æ¥æ•°
âœ… innodb_buffer_pool_size  # InnoDBç¼“å†²æ± ï¼ˆMySQL 5.7+ï¼‰
âœ… query_cache_size         # æŸ¥è¯¢ç¼“å­˜å¤§å°
âœ… sort_buffer_size         # æ’åºç¼“å†²åŒº

é™æ€å‚æ•°ï¼ˆéœ€é‡å¯ç”Ÿæ•ˆï¼‰ï¼š
âŒ innodb_log_file_size     # æ—¥å¿—æ–‡ä»¶å¤§å°
âŒ innodb_page_size         # é¡µé¢å¤§å°  
âŒ datadir                  # æ•°æ®ç›®å½•
âŒ port                     # ç«¯å£å·
```

**âš¡ åœ¨çº¿è°ƒä¼˜ç¤ºä¾‹**
```bash
# pt-variable-advisorè¯†åˆ«å¯åŠ¨æ€è°ƒæ•´çš„å‚æ•°
pt-variable-advisor --report-format vertical | grep -A3 "Dynamic: Yes"

# å®‰å…¨çš„åœ¨çº¿è°ƒæ•´æµç¨‹
mysql> SELECT $$max_connections;  # è®°å½•å½“å‰å€¼
mysql> SET GLOBAL max_connections = 500;  # è°ƒæ•´å‚æ•°
mysql> SELECT $$max_connections;  # ç¡®è®¤ç”Ÿæ•ˆ

# è§‚å¯Ÿè°ƒæ•´æ•ˆæœ
mysql> SHOW STATUS LIKE 'Max_used_connections';
```

### 5.2 è°ƒä¼˜å†å²è·Ÿè¸ª


**ğŸ“ˆ å‚æ•°å˜æ›´è®°å½•**
```bash
# å»ºç«‹å‚æ•°è°ƒä¼˜å†å²è¡¨
CREATE TABLE mysql_tuning_history (
    id INT AUTO_INCREMENT PRIMARY KEY,
    change_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    parameter_name VARCHAR(100),
    old_value VARCHAR(200),
    new_value VARCHAR(200),
    reason TEXT,
    performance_impact TEXT
);

# è®°å½•æ¯æ¬¡è°ƒä¼˜
INSERT INTO mysql_tuning_history 
(parameter_name, old_value, new_value, reason)
VALUES 
('max_connections', '151', '500', 'pt-variable-advisorå»ºè®®å¢åŠ å¹¶å‘è¿æ¥æ•°');
```

### 5.3 è°ƒä¼˜æ•ˆæœè¯„ä¼°


**ğŸ“Š æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”**
```sql
-- è°ƒä¼˜å‰åçš„æ€§èƒ½å¯¹æ¯”æŸ¥è¯¢
SELECT 
    DATE(change_time) as tune_date,
    parameter_name,
    old_value,
    new_value,
    performance_impact
FROM mysql_tuning_history 
ORDER BY change_time DESC;

-- å…³é”®æ€§èƒ½æŒ‡æ ‡ç›‘æ§
SHOW STATUS WHERE Variable_name IN (
    'Connections',
    'Max_used_connections', 
    'Threads_created',
    'Threads_cached'
);
```

---

## 6. ğŸ“š é…ç½®æ¨¡æ¿åº“ä¸æœ€ä½³å®è·µ


### 6.1 å†…ç½®é…ç½®æ¨¡æ¿


**ğŸ¯ åœºæ™¯åŒ–æ¨¡æ¿**
```bash
pt-variable-advisoræä¾›çš„å…¸å‹åœºæ™¯æ¨¡æ¿ï¼š

Webåº”ç”¨åœºæ™¯ï¼š
â”œâ”€ é«˜å¹¶å‘è¯»å†™éœ€æ±‚
â”œâ”€ ä¸­ç­‰æ•°æ®é‡ï¼ˆ< 100GBï¼‰
â”œâ”€ å†…å­˜ä¼˜åŒ–é…ç½®
â””â”€ è¿æ¥æ± ä¼˜åŒ–

æ•°æ®ä»“åº“åœºæ™¯ï¼š  
â”œâ”€ å¤§æ‰¹é‡æ•°æ®å¤„ç†
â”œâ”€ å¤æ‚æŸ¥è¯¢è¾ƒå¤š
â”œâ”€ ç£ç›˜IOä¼˜åŒ–
â””â”€ æ’åºå†…å­˜ä¼˜åŒ–

OLTPé«˜é¢‘äº¤æ˜“ï¼š
â”œâ”€ æé«˜å¹¶å‘è¦æ±‚
â”œâ”€ ä½å»¶è¿Ÿéœ€æ±‚
â”œâ”€ äº‹åŠ¡å¤„ç†ä¼˜åŒ–
â””â”€ é”ç«äº‰æœ€å°åŒ–
```

### 6.2 æœ€ä½³å®è·µå¯¹æ¯”


**ğŸ“‹ é…ç½®æœ€ä½³å®è·µè¡¨**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å‚æ•°åç§°      â”‚  å°å‹   â”‚  ä¸­å‹   â”‚  å¤§å‹   â”‚
â”‚                  â”‚ (2-4GB) â”‚ (8-16GB)â”‚ (32GB+) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚innodb_buffer_poolâ”‚   1GB   â”‚   6GB   â”‚  24GB   â”‚
â”‚_size             â”‚         â”‚         â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚max_connections   â”‚   200   â”‚   500   â”‚  1000   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚thread_cache_size â”‚    50   â”‚   100   â”‚   200   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚sort_buffer_size  â”‚   1MB   â”‚   2MB   â”‚   4MB   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 é…ç½®åˆè§„æ£€æŸ¥


**âœ… åˆè§„æ€§éªŒè¯**
```bash
# æ£€æŸ¥é…ç½®æ˜¯å¦ç¬¦åˆä¼ä¸šæ ‡å‡†
pt-variable-advisor --ignore-rules "notice" \
  --source-of-variables show-variables

# ä¼ä¸šçº§å®‰å…¨åˆè§„æ£€æŸ¥ç‚¹ï¼š
åˆè§„æ£€æŸ¥é¡¹ç›®ï¼š
â”œâ”€ å¯†ç ç­–ç•¥å¼ºåº¦ â‰¥ MEDIUM
â”œâ”€ SSLåŠ å¯†å¿…é¡»å¯ç”¨
â”œâ”€ å®¡è®¡æ—¥å¿—å¿…é¡»å¼€å¯  
â”œâ”€ æ–‡ä»¶æƒé™å¿…é¡»é™åˆ¶
â””â”€ è¿œç¨‹rootç™»å½•å¿…é¡»ç¦ç”¨
```

---

## 7. ğŸ”„ å‚æ•°ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†


### 7.1 ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥


**ğŸ“± å¤šç‰ˆæœ¬å‚æ•°å¯¹æ¯”**
```
MySQLç‰ˆæœ¬æ¼”è¿›ä¸­çš„å‚æ•°å˜åŒ–ï¼š

MySQL 5.7 â†’ 8.0 é‡è¦å˜æ›´ï¼š
â”œâ”€ query_cache_* å‚æ•°è¢«ç§»é™¤
â”œâ”€ innodb_buffer_pool_size æ”¯æŒåœ¨çº¿è°ƒæ•´
â”œâ”€ validate_password æ”¹ä¸ºæ’ä»¶å½¢å¼
â””â”€ é»˜è®¤è®¤è¯æ’ä»¶å˜æ›´ä¸º caching_sha2_password

pt-variable-advisorä¼šæ£€æŸ¥ï¼š
âœ… å½“å‰ç‰ˆæœ¬æ˜¯å¦æ”¯æŒæŸå‚æ•°
âœ… å‚æ•°æ˜¯å¦å·²è¢«åºŸå¼ƒ
âœ… æ˜¯å¦æœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆ
```

### 7.2 å‚æ•°è¿ç§»å»ºè®®


**ğŸ”„ ç‰ˆæœ¬å‡çº§æŒ‡å¯¼**
```bash
# æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
pt-variable-advisor --source-of-variables mysql \
  | grep -E "(deprecated|removed|changed)"

# å…¸å‹è¿ç§»å»ºè®®ï¼š
ç‰ˆæœ¬å‡çº§å»ºè®®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQL 5.7 â†’ 8.0 å‚æ•°è¿ç§»æŒ‡å—           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç§»é™¤: query_cache_size                  â”‚
â”‚ æ›¿ä»£: åº”ç”¨å±‚ç¼“å­˜ï¼ˆRedisï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å˜æ›´: default_authentication_plugin    â”‚  
â”‚ æ“ä½œ: æ›´æ–°å®¢æˆ·ç«¯è¿æ¥æ–¹å¼               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–°å¢: innodb_dedicated_server          â”‚
â”‚ å»ºè®®: ä¸“ç”¨æœåŠ¡å™¨å»ºè®®å¯ç”¨               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 å‚æ•°å›æ»šæœºåˆ¶


**ğŸ”™ å®‰å…¨å›æ»šç­–ç•¥**
```sql
-- åˆ›å»ºå‚æ•°å˜æ›´å›æ»šè¡¨
CREATE TABLE mysql_parameter_rollback (
    rollback_id INT AUTO_INCREMENT PRIMARY KEY,
    change_date DATETIME,
    parameter_name VARCHAR(100),
    original_value TEXT,
    rollback_command TEXT,
    rollback_tested BOOLEAN DEFAULT FALSE
);

-- å˜æ›´å‰è®°å½•å›æ»šä¿¡æ¯
INSERT INTO mysql_parameter_rollback 
(parameter_name, original_value, rollback_command)
SELECT 
    'max_connections',
    $$max_connections,
    CONCAT('SET GLOBAL max_connections = ', $$max_connections, ';');
```

**âš¡ å¿«é€Ÿå›æ»šæ“ä½œ**
```bash
# ç´§æ€¥å›æ»šè„šæœ¬
#!/bin/bash
# rollback_mysql_params.sh

mysql -u root -p << EOF
-- å›æ»šå…³é”®å‚æ•°
SET GLOBAL max_connections = 151;
SET GLOBAL innodb_buffer_pool_size = 128M;
SET GLOBAL thread_cache_size = 8;

-- éªŒè¯å›æ»šç»“æœ
SELECT $$max_connections, $$innodb_buffer_pool_size, $$thread_cache_size;
EOF

echo "å‚æ•°å·²å›æ»šï¼Œè¯·æ£€æŸ¥æœåŠ¡çŠ¶æ€"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ¯ pt-variable-advisoræ ¸å¿ƒä»·å€¼ï¼š
â”œâ”€ è‡ªåŠ¨åŒ–çš„MySQLé…ç½®å¥åº·æ£€æŸ¥å·¥å…·
â”œâ”€ åŸºäºæœ€ä½³å®è·µçš„ä¼˜åŒ–å»ºè®®ç”Ÿæˆå™¨  
â”œâ”€ å®‰å…¨é£é™©å’Œæ€§èƒ½é—®é¢˜çš„é¢„è­¦ç³»ç»Ÿ
â””â”€ é…ç½®å˜æ›´çš„å½±å“åˆ†æå’ŒæŒ‡å¯¼å·¥å…·
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ” å·¥å…·ä½¿ç”¨çš„æ ¸å¿ƒåŸåˆ™**
```
ä½¿ç”¨pt-variable-advisorçš„æ­£ç¡®æ–¹å¼ï¼š

1ï¸âƒ£ å®šæœŸä½“æ£€
â”œâ”€ æ¯æœˆè¿è¡Œä¸€æ¬¡å…¨é¢æ£€æŸ¥
â”œâ”€ ä¸šåŠ¡å¢é•¿ååŠæ—¶é‡æ–°è¯„ä¼°
â””â”€ ç‰ˆæœ¬å‡çº§å‰åå¯¹æ¯”åˆ†æ

2ï¸âƒ£ æ¸è¿›ä¼˜åŒ–  
â”œâ”€ ä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰å‚æ•°
â”œâ”€ ä¼˜å…ˆå¤„ç†é«˜é£é™©å’Œé«˜å½±å“çš„é—®é¢˜
â””â”€ æ¯æ¬¡ä¿®æ”¹åè§‚å¯Ÿæ•ˆæœå†ç»§ç»­

3ï¸âƒ£ ç¯å¢ƒé€‚é…
â”œâ”€ å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒåˆ†åˆ«æ£€æŸ¥
â”œâ”€ æ ¹æ®å®é™…ç¡¬ä»¶èµ„æºè°ƒæ•´å»ºè®®
â””â”€ è€ƒè™‘ä¸šåŠ¡ç‰¹ç‚¹å®šåˆ¶é…ç½®
```

**ğŸ¯ å‚æ•°è°ƒä¼˜çš„å®è·µæ™ºæ…§**
```
é¿å…å¸¸è§è¯¯åŒºï¼š

âŒ ç›²ç›®è¿½æ±‚æ‰€æœ‰å‚æ•°éƒ½"ç»¿è‰²"
âœ… é‡ç‚¹å…³æ³¨å½±å“ä¸šåŠ¡çš„å…³é”®å‚æ•°

âŒ ç…§æ¬ç½‘ä¸Šçš„"æœ€ä¼˜"é…ç½®  
âœ… æ ¹æ®è‡ªå·±çš„ç¯å¢ƒå’Œè´Ÿè½½ç‰¹ç‚¹è°ƒæ•´

âŒ ä¸€æ¬¡æ€§å¤§å¹…è°ƒæ•´å‚æ•°
âœ… å°æ­¥å¿«è·‘ï¼Œé€æ­¥ä¼˜åŒ–

âŒ åªå…³æ³¨æ€§èƒ½ï¼Œå¿½è§†å®‰å…¨
âœ… å®‰å…¨å’Œæ€§èƒ½å¹¶é‡ï¼Œå¹³è¡¡è€ƒè™‘
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç³»ç»Ÿä¸Šçº¿å‰**ï¼šå…¨é¢æ£€æŸ¥é…ç½®ï¼Œé¿å…æ€§èƒ½é™·é˜±
- **æ€§èƒ½é—®é¢˜æ’æŸ¥**ï¼šå¿«é€Ÿè¯†åˆ«é…ç½®å±‚é¢çš„é—®é¢˜
- **ç‰ˆæœ¬å‡çº§**ï¼šç¡®ä¿å‚æ•°å…¼å®¹æ€§ï¼Œå¹³æ»‘è¿ç§»
- **å®šæœŸå·¡æ£€**ï¼šæŒç»­ä¼˜åŒ–ï¼Œé¢„é˜²é—®é¢˜å‘ç”Ÿ

**ğŸ”§ è¿ç»´å®è·µè¦ç‚¹**
```
å»ºç«‹é…ç½®ç®¡ç†æµç¨‹ï¼š

æ£€æŸ¥é˜¶æ®µï¼š
â”œâ”€ ä½¿ç”¨pt-variable-advisorå…¨é¢æ‰«æ
â”œâ”€ è¯†åˆ«é«˜ä¼˜å…ˆçº§çš„ä¼˜åŒ–é¡¹ç›®
â””â”€ åˆ¶å®šåˆ†æ‰¹æ¬¡çš„è°ƒä¼˜è®¡åˆ’

è°ƒæ•´é˜¶æ®µï¼š
â”œâ”€ åœ¨æµ‹è¯•ç¯å¢ƒå…ˆè¡ŒéªŒè¯
â”œâ”€ è®°å½•å˜æ›´å‰çš„åŸå§‹é…ç½®
â””â”€ å‡†å¤‡å›æ»šæ–¹æ¡ˆå’Œç›‘æ§æŒ‡æ ‡

éªŒè¯é˜¶æ®µï¼š  
â”œâ”€ ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡å˜åŒ–
â”œâ”€ æ”¶é›†ç”¨æˆ·åé¦ˆå’Œä¸šåŠ¡æ•°æ®
â””â”€ è¯„ä¼°è°ƒä¼˜æ•ˆæœï¼Œå†³å®šæ˜¯å¦ä¿ç•™
```

### 8.4 è¿›é˜¶ä½¿ç”¨æŠ€å·§


**ğŸš€ é«˜çº§åº”ç”¨åœºæ™¯**
```
è‡ªåŠ¨åŒ–é›†æˆï¼š
â”œâ”€ é›†æˆåˆ°ç›‘æ§ç³»ç»Ÿå®šæœŸæ£€æŸ¥
â”œâ”€ ç»“åˆé…ç½®ç®¡ç†å·¥å…·æ‰¹é‡ä¼˜åŒ–
â”œâ”€ å»ºç«‹å‚æ•°åŸºçº¿å’Œå˜æ›´å®¡æ‰¹æµç¨‹
â””â”€ å¼€å‘è‡ªå®šä¹‰è§„åˆ™æ‰©å±•æ£€æŸ¥èŒƒå›´

å›¢é˜Ÿåä½œï¼š
â”œâ”€ å»ºç«‹é…ç½®æ ‡å‡†å’Œæœ€ä½³å®è·µæ–‡æ¡£
â”œâ”€ åŸ¹è®­å›¢é˜Ÿæˆå‘˜ä½¿ç”¨å·¥å…·å’Œç†è§£åŸç†
â”œâ”€ å»ºç«‹é…ç½®è¯„å®¡å’Œå˜æ›´ç®¡ç†æµç¨‹  
â””â”€ åˆ†äº«è°ƒä¼˜ç»éªŒå’Œæ¡ˆä¾‹æ€»ç»“
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- pt-variable-advisoræ˜¯é…ç½®ä½“æ£€åŒ»ç”Ÿï¼Œå®šæœŸæ£€æŸ¥æ‰¾é—®é¢˜
- å®‰å…¨ç¬¬ä¸€æ€§èƒ½å…¶æ¬¡ï¼Œæ¸è¿›ä¼˜åŒ–ä¸ç€æ€¥
- è®°å½•å˜æ›´å‡†å¤‡å›æ»šï¼Œæµ‹è¯•éªŒè¯å†ä¸Šçº¿
- å› åœ°åˆ¶å®œé‡ä½“è£è¡£ï¼Œæœ€é€‚åˆçš„å°±æœ€å¥½