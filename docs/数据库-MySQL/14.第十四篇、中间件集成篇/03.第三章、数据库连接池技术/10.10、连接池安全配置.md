---
title: 10ã€è¿æ¥æ± å®‰å…¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [è¿æ¥æ± å®‰å…¨åŸºç¡€æ¦‚å¿µ](#1-è¿æ¥æ± å®‰å…¨åŸºç¡€æ¦‚å¿µ)
2. [æ•°æ®åº“è¿æ¥åŠ å¯†é…ç½®](#2-æ•°æ®åº“è¿æ¥åŠ å¯†é…ç½®)
3. [è¿æ¥æ± è®¿é—®æ§åˆ¶](#3-è¿æ¥æ± è®¿é—®æ§åˆ¶)
4. [å¯†ç å®‰å…¨å­˜å‚¨](#4-å¯†ç å®‰å…¨å­˜å‚¨)
5. [SSLè¿æ¥é…ç½®](#5-SSLè¿æ¥é…ç½®)
6. [è¿æ¥å®¡è®¡æ—¥å¿—](#6-è¿æ¥å®¡è®¡æ—¥å¿—)
7. [æƒé™æœ€å°åŒ–åŸåˆ™](#7-æƒé™æœ€å°åŒ–åŸåˆ™)
8. [å®‰å…¨é…ç½®åŸºçº¿](#8-å®‰å…¨é…ç½®åŸºçº¿)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” è¿æ¥æ± å®‰å…¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è¿æ¥æ± å®‰å…¨

**ç®€å•ç†è§£**ï¼šè¿æ¥æ± å®‰å…¨å°±åƒé“¶è¡Œçš„ä¿é™©æŸœç³»ç»Ÿï¼Œè¦ç¡®ä¿æ•°æ®åº“è¿æ¥è¿™äº›"é’¥åŒ™"çš„å®‰å…¨ç®¡ç†ã€‚

```
ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š
é…’åº—é’¥åŒ™ç®¡ç† â†’ è¿æ¥æ± å®‰å…¨ç®¡ç†
â”œâ”€â”€ é’¥åŒ™åŠ å¯†å­˜æ”¾ â†’ è¿æ¥ä¿¡æ¯åŠ å¯†
â”œâ”€â”€ èº«ä»½éªŒè¯é¢†å– â†’ è®¿é—®æ§åˆ¶è®¤è¯  
â”œâ”€â”€ ä½¿ç”¨è®°å½•è¿½è¸ª â†’ è¿æ¥å®¡è®¡æ—¥å¿—
â””â”€â”€ æƒé™åˆ†çº§ç®¡ç† â†’ æœ€å°æƒé™åŸåˆ™
```

> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> è¿æ¥æ± å®‰å…¨æ˜¯ä¿æŠ¤æ•°æ®åº“è¿æ¥ä¿¡æ¯å’Œè¿æ¥è¿‡ç¨‹ä¸è¢«æ¶æ„åˆ©ç”¨çš„æŠ€æœ¯ä½“ç³»ï¼ŒåŒ…æ‹¬è¿æ¥åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€å¯†ç ä¿æŠ¤ç­‰å¤šä¸ªæ–¹é¢ã€‚

### 1.2 ä¸ºä»€ä¹ˆè¿æ¥æ± å®‰å…¨å¾ˆé‡è¦


**å¸¸è§å®‰å…¨é£é™©**ï¼š
```
é£é™©ç±»å‹åˆ†æï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é£é™©ç±»å‹      â”‚     å±å®³åæœ     â”‚     é˜²æŠ¤æªæ–½     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯†ç æ˜æ–‡å­˜å‚¨    â”‚ æ•°æ®åº“è¢«å…¥ä¾µ     â”‚ å¯†ç åŠ å¯†å­˜å‚¨     â”‚
â”‚ è¿æ¥ä¿¡æ¯æ³„éœ²    â”‚ æ•æ„Ÿæ•°æ®æš´éœ²     â”‚ ä¼ è¾“åŠ å¯†é…ç½®     â”‚  
â”‚ æƒé™è¿‡åº¦åˆ†é…    â”‚ è¶Šæƒè®¿é—®é£é™©     â”‚ æœ€å°æƒé™åŸåˆ™     â”‚
â”‚ ç¼ºå°‘å®¡è®¡è®°å½•    â”‚ æ— æ³•è¿½è¸ªæ”»å‡»     â”‚ å®Œæ•´å®¡è®¡æ—¥å¿—     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®é™…å½±å“**ï¼š
- **æ•°æ®æ³„éœ²**ï¼šå®¢æˆ·ä¿¡æ¯ã€è´¢åŠ¡æ•°æ®è¢«ç›—å–
- **ä¸šåŠ¡ä¸­æ–­**ï¼šæ•°æ®åº“è¢«æ”»å‡»å¯¼è‡´æœåŠ¡åœæ­¢  
- **æ³•å¾‹é£é™©**ï¼šè¿åæ•°æ®ä¿æŠ¤æ³•è§„é¢ä¸´ç½šæ¬¾
- **ä¿¡èª‰æŸå¤±**ï¼šç”¨æˆ·ä¿¡ä»»åº¦ä¸¥é‡ä¸‹é™

### 1.3 å®‰å…¨é˜²æŠ¤çš„å±‚æ¬¡ç»“æ„


```
å®‰å…¨é˜²æŠ¤ä½“ç³»æ¶æ„ï¼š
                åº”ç”¨å±‚å®‰å…¨
                    â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   è¿æ¥æ± å®‰å…¨å±‚       â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚ â€¢ è®¿é—®æ§åˆ¶          â”‚
           â”‚ â€¢ è¿æ¥åŠ å¯†          â”‚  
           â”‚ â€¢ å¯†ç ä¿æŠ¤          â”‚
           â”‚ â€¢ å®¡è®¡æ—¥å¿—          â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
               ç½‘ç»œä¼ è¾“å®‰å…¨
                    â†“
              æ•°æ®åº“æœåŠ¡å™¨å®‰å…¨
```

---

## 2. ğŸ”’ æ•°æ®åº“è¿æ¥åŠ å¯†é…ç½®


### 2.1 ä»€ä¹ˆæ˜¯è¿æ¥åŠ å¯†

**é€šä¿—è§£é‡Š**ï¼šè¿æ¥åŠ å¯†å°±åƒç»™ä¿¡ä»¶è£…è¿›å¯†ç ç®±ï¼Œåªæœ‰çŸ¥é“å¯†ç çš„äººæ‰èƒ½æ‰“å¼€çœ‹åˆ°å†…å®¹ã€‚

```
ä¼ è¾“è¿‡ç¨‹å¯¹æ¯”ï¼š
æ˜æ–‡ä¼ è¾“ï¼šåº”ç”¨ç¨‹åº â€”â€”â€”â€” ç”¨æˆ·åå¯†ç  â€”â€”â€”â€” â†’ æ•°æ®åº“
          â†‘ å®¹æ˜“è¢«çªƒå¬å’Œç¯¡æ”¹

åŠ å¯†ä¼ è¾“ï¼šåº”ç”¨ç¨‹åº â€”â€”â€” ğŸ” åŠ å¯†é€šé“ ğŸ” â€”â€”â€” â†’ æ•°æ®åº“  
          â†‘ å³ä½¿è¢«æˆªè·ä¹Ÿæ— æ³•è§£è¯»
```

### 2.2 å¸¸è§åŠ å¯†æ–¹å¼é…ç½®


#### ğŸ“Š MySQLåŠ å¯†è¿æ¥é…ç½®


```properties
# HikariCPè¿æ¥æ± åŠ å¯†é…ç½®
spring.datasource.hikari.jdbc-url=jdbc:mysql://localhost:3306/testdb?useSSL=true&requireSSL=true
spring.datasource.hikari.username=dbuser
spring.datasource.hikari.password=${DB_PASSWORD}

# åŠ å¯†ç›¸å…³å‚æ•°è¯¦è§£
useSSL=true              # å¯ç”¨SSLåŠ å¯†
requireSSL=true          # å¼ºåˆ¶è¦æ±‚SSLè¿æ¥
verifyServerCertificate=true  # éªŒè¯æœåŠ¡å™¨è¯ä¹¦
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> `requireSSL=true` è¡¨ç¤ºå¦‚æœæ— æ³•å»ºç«‹SSLè¿æ¥ï¼Œç³»ç»Ÿä¼šç›´æ¥æ‹’ç»è¿æ¥ï¼Œè€Œä¸æ˜¯é™çº§åˆ°æ˜æ–‡ä¼ è¾“ã€‚

#### ğŸ“Š PostgreSQLåŠ å¯†è¿æ¥é…ç½®


```properties
# PostgreSQL SSLé…ç½®ç¤ºä¾‹
spring.datasource.url=jdbc:postgresql://localhost:5432/testdb?ssl=true&sslmode=require
spring.datasource.username=pguser
spring.datasource.password=${PG_PASSWORD}

# SSLæ¨¡å¼è¯´æ˜
sslmode=disable    # ä¸ä½¿ç”¨SSLï¼ˆä¸æ¨èï¼‰
sslmode=require    # å¿…é¡»ä½¿ç”¨SSL
sslmode=verify-ca  # SSL + éªŒè¯CAè¯ä¹¦
sslmode=verify-full # SSL + éªŒè¯CA + éªŒè¯ä¸»æœºå
```

### 2.3 è¯ä¹¦ç®¡ç†é…ç½®


```bash
# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
openssl req -x509 -newkey rsa:4096 -keyout server-key.pem -out server-cert.pem -days 365

# ç”Ÿäº§ç¯å¢ƒè¯ä¹¦é…ç½®
# 1. ç”³è¯·æ­£å¼SSLè¯ä¹¦
# 2. é…ç½®è¯ä¹¦è·¯å¾„
ssl-ca=/path/to/ca-cert.pem
ssl-cert=/path/to/server-cert.pem  
ssl-key=/path/to/server-key.pem
```

---

## 3. ğŸ›¡ï¸ è¿æ¥æ± è®¿é—®æ§åˆ¶


### 3.1 è®¿é—®æ§åˆ¶åŸºæœ¬æ¦‚å¿µ

**ç®€å•ç†è§£**ï¼šè®¿é—®æ§åˆ¶å°±åƒå…¬å¸é—¨ç¦ç³»ç»Ÿï¼Œåªæœ‰æœ‰æƒé™çš„å‘˜å·¥æ‰èƒ½è¿›å…¥ç‰¹å®šåŒºåŸŸã€‚

```
æƒé™æ§åˆ¶æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ èº«ä»½éªŒè¯ â†’ æƒé™æ£€æŸ¥ â†’ èµ„æºè®¿é—®
    â†“          â†“          â†“          â†“
 è°åœ¨è®¿é—®   æ˜¯å¦åˆæ³•ç”¨æˆ·  æœ‰å“ªäº›æƒé™  å…è®¸æ“ä½œ
```

### 3.2 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰


#### ğŸ“‹ è§’è‰²æƒé™è®¾è®¡


| è§’è‰²ç±»å‹ | **æ•°æ®åº“æƒé™** | **è¿æ¥æ± é…ç½®** | **åº”ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| ğŸ”´ **ç®¡ç†å‘˜** | `ALL PRIVILEGES` | `æœ€å¤§è¿æ¥æ•°` | `ç³»ç»Ÿç»´æŠ¤` |
| ğŸŸ¡ **å¼€å‘è€…** | `SELECT, INSERT, UPDATE` | `ä¸­ç­‰è¿æ¥æ•°` | `åº”ç”¨å¼€å‘` |
| ğŸŸ¢ **åªè¯»ç”¨æˆ·** | `SELECT` | `æœ‰é™è¿æ¥æ•°` | `æŠ¥è¡¨æŸ¥è¯¢` |
| ğŸ”µ **åº”ç”¨æœåŠ¡** | `æŒ‡å®šè¡¨æƒé™` | `ä¸šåŠ¡è¿æ¥æ•°` | `ç”Ÿäº§è¿è¡Œ` |

#### ğŸ“Š Spring Securityé›†æˆç¤ºä¾‹


```java
@Configuration
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class DatabaseSecurityConfig {
    
    // åŸºäºè§’è‰²çš„æ•°æ®æºé…ç½®
    @Bean
    @ConfigurationProperties("spring.datasource.admin")
    public DataSource adminDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    @Bean  
    @ConfigurationProperties("spring.datasource.readonly")
    public DataSource readOnlyDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    // æƒé™æ£€æŸ¥ç¤ºä¾‹
    @PreAuthorize("hasRole('ADMIN')")
    public void adminOperation() {
        // ç®¡ç†å‘˜æ“ä½œ
    }
    
    @PreAuthorize("hasRole('USER')")  
    public void userOperation() {
        // æ™®é€šç”¨æˆ·æ“ä½œ
    }
}
```

### 3.3 IPç™½åå•æ§åˆ¶


```properties
# è¿æ¥æ± IPè®¿é—®æ§åˆ¶é…ç½®
spring.datasource.hikari.connection-init-sql=SET @user_ip = CONNECTION_ID()

# MySQLç”¨æˆ·IPé™åˆ¶
CREATE USER 'appuser'@'192.168.1.%' IDENTIFIED BY 'password';
CREATE USER 'readonly'@'10.0.0.%' IDENTIFIED BY 'password';

# åº”ç”¨çº§IPè¿‡æ»¤
management.endpoint.health.show-details=when-authorized
management.endpoints.web.exposure.include=health,info
management.endpoints.web.base-path=/actuator
```

---

## 4. ğŸ”‘ å¯†ç å®‰å…¨å­˜å‚¨


### 4.1 å¯†ç å­˜å‚¨å®‰å…¨åŸåˆ™

**æ ¸å¿ƒç†å¿µ**ï¼šæ°¸è¿œä¸è¦ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨æ•°æ®åº“å¯†ç ï¼Œå°±åƒä¸è¦æŠŠé“¶è¡Œå¯†ç å†™åœ¨çº¸æ¡ä¸Šã€‚

> ğŸ“Œ **å¯†ç å®‰å…¨é»„é‡‘æ³•åˆ™**  
> 1. å¯†ç å¿…é¡»åŠ å¯†å­˜å‚¨
> 2. ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥  
> 3. å®šæœŸè½®æ¢å¯†ç 
> 4. é™åˆ¶å¯†ç è®¿é—®æƒé™

### 4.2 ç¯å¢ƒå˜é‡å¯†ç é…ç½®


```bash
# ç¯å¢ƒå˜é‡è®¾ç½®ï¼ˆæ¨èæ–¹å¼ï¼‰
export DB_PASSWORD="your_secure_password"
export DB_USERNAME="your_username"
export DB_URL="jdbc:mysql://localhost:3306/database"

# Dockerç¯å¢ƒå˜é‡
docker run -e DB_PASSWORD=secret_password myapp:latest

# Kubernetes Secret
kubectl create secret generic db-secret \
  --from-literal=username=dbuser \
  --from-literal=password=securepassword
```

```properties
# åº”ç”¨é…ç½®æ–‡ä»¶å¼•ç”¨ç¯å¢ƒå˜é‡
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# é¿å…ç¡¬ç¼–ç ï¼ˆé”™è¯¯ç¤ºä¾‹ï¼‰
# spring.datasource.password=123456  âŒ ç»å¯¹ä¸è¦è¿™æ ·åš
```

### 4.3 åŠ å¯†é…ç½®æ–‡ä»¶


#### ğŸ“Š JasyptåŠ å¯†é…ç½®


```xml
<!-- Mavenä¾èµ– -->
<dependency>
    <groupId>com.github.ulisesbocchio</groupId>
    <artifactId>jasypt-spring-boot-starter</artifactId>
    <version>3.0.4</version>
</dependency>
```

```properties
# åŠ å¯†åçš„é…ç½®æ–‡ä»¶
spring.datasource.username=ENC(encrypted_username)
spring.datasource.password=ENC(encrypted_password)

# åŠ å¯†å¯†é’¥ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡æä¾›ï¼‰
jasypt.encryptor.password=${JASYPT_ENCRYPTOR_PASSWORD}
```

```java
// å¯†ç åŠ å¯†å·¥å…·ç±»
@Component
public class PasswordEncryptor {
    
    @Autowired
    private StringEncryptor encryptor;
    
    // åŠ å¯†å¯†ç 
    public String encryptPassword(String plainPassword) {
        return encryptor.encrypt(plainPassword);
    }
    
    // è§£å¯†å¯†ç ï¼ˆæ¡†æ¶è‡ªåŠ¨å¤„ç†ï¼‰
    public String decryptPassword(String encryptedPassword) {
        return encryptor.decrypt(encryptedPassword);
    }
}
```

### 4.4 å¯†é’¥ç®¡ç†æœåŠ¡é›†æˆ


```java
// AWS Secrets Manageré›†æˆç¤ºä¾‹
@Service
public class SecretsManagerService {
    
    private final AWSSecretsManager secretsManager;
    
    public DatabaseCredentials getDatabaseCredentials() {
        GetSecretValueRequest request = new GetSecretValueRequest()
            .withSecretId("prod/mysql/credentials");
            
        GetSecretValueResult result = secretsManager.getSecretValue(request);
        
        // è§£æJSONæ ¼å¼çš„å¯†é’¥
        ObjectMapper mapper = new ObjectMapper();
        return mapper.readValue(result.getSecretString(), 
                               DatabaseCredentials.class);
    }
}
```

---

## 5. ğŸ” SSLè¿æ¥é…ç½®


### 5.1 SSLè¿æ¥å·¥ä½œåŸç†

**å½¢è±¡æ¯”å–»**ï¼šSSLå°±åƒç»™é‚®ä»¶åŠ ä¸Šå¯†ç é”ï¼Œé‚®é€’å‘˜å¯ä»¥é€ä¿¡ï¼Œä½†åªæœ‰æ”¶ä¿¡äººèƒ½æ‰“å¼€ã€‚

```
SSLæ¡æ‰‹è¿‡ç¨‹ï¼š
å®¢æˆ·ç«¯                              æœåŠ¡å™¨
   |                                 |
   |----[1] è¯·æ±‚å»ºç«‹SSLè¿æ¥--------->|
   |<---[2] å‘é€æœåŠ¡å™¨è¯ä¹¦-----------|
   |----[3] éªŒè¯è¯ä¹¦å¹¶ç”Ÿæˆå¯†é’¥------>|
   |<---[4] ç¡®è®¤å¯†é’¥----------------| 
   |                                 |
   |========= åŠ å¯†é€šä¿¡é€šé“ =========|
```

### 5.2 MySQL SSLé…ç½®è¯¦è§£


#### ğŸ“Š æœåŠ¡å™¨ç«¯SSLé…ç½®


```ini
# MySQLé…ç½®æ–‡ä»¶ my.cnf
[mysqld]
# å¯ç”¨SSL
ssl-ca=/path/to/ca-cert.pem
ssl-cert=/path/to/server-cert.pem
ssl-key=/path/to/server-key.pem

# SSLè¿æ¥è®¾ç½®
require_secure_transport=ON  # å¼ºåˆ¶SSLè¿æ¥
ssl-cipher=ECDHE-RSA-AES128-GCM-SHA256

# æŸ¥çœ‹SSLçŠ¶æ€
SHOW VARIABLES LIKE '%ssl%';
```

#### ğŸ“Š å®¢æˆ·ç«¯SSLé…ç½®


```properties
# å®Œæ•´çš„SSLè¿æ¥é…ç½®
spring.datasource.hikari.jdbc-url=jdbc:mysql://localhost:3306/testdb?\
useSSL=true&\
requireSSL=true&\
verifyServerCertificate=true&\
trustCertificateKeyStoreUrl=file:/path/to/truststore.jks&\
trustCertificateKeyStorePassword=truststore_password&\
clientCertificateKeyStoreUrl=file:/path/to/keystore.jks&\
clientCertificateKeyStorePassword=keystore_password
```

### 5.3 SSLè¯ä¹¦ç®¡ç†


```bash
# åˆ›å»ºCAæ ¹è¯ä¹¦
openssl genrsa -out ca-key.pem 4096
openssl req -new -x509 -key ca-key.pem -out ca-cert.pem -days 3650

# åˆ›å»ºæœåŠ¡å™¨è¯ä¹¦
openssl genrsa -out server-key.pem 4096
openssl req -new -key server-key.pem -out server-req.pem
openssl x509 -req -in server-req.pem -CA ca-cert.pem -CAkey ca-key.pem \
  -out server-cert.pem -days 365 -CAcreateserial

# åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦  
openssl genrsa -out client-key.pem 4096
openssl req -new -key client-key.pem -out client-req.pem
openssl x509 -req -in client-req.pem -CA ca-cert.pem -CAkey ca-key.pem \
  -out client-cert.pem -days 365 -CAcreateserial
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨æ­£å¼CAæœºæ„ç­¾å‘çš„è¯ä¹¦ï¼Œå¼€å‘æµ‹è¯•ç¯å¢ƒå¯ä»¥ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚

---

## 6. ğŸ“Š è¿æ¥å®¡è®¡æ—¥å¿—


### 6.1 å®¡è®¡æ—¥å¿—çš„é‡è¦æ€§

**ç®€å•ç†è§£**ï¼šå®¡è®¡æ—¥å¿—å°±åƒé“¶è¡Œçš„ç›‘æ§å½•åƒï¼Œè®°å½•ä¸‹æ¯ä¸€æ¬¡æ•°æ®åº“è®¿é—®çš„è¯¦ç»†ä¿¡æ¯ã€‚

```
å®¡è®¡ä¿¡æ¯åŒ…å«ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®°å½•å†…å®¹      â”‚      ç¤ºä¾‹å€¼     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¿é—®æ—¶é—´        â”‚ 2024-01-15 14:30â”‚
â”‚ ç”¨æˆ·èº«ä»½        â”‚ app_user        â”‚
â”‚ æºIPåœ°å€        â”‚ 192.168.1.100   â”‚
â”‚ æ‰§è¡Œæ“ä½œ        â”‚ SELECT, UPDATE  â”‚
â”‚ è®¿é—®è¡¨å        â”‚ user_info       â”‚
â”‚ æ“ä½œç»“æœ        â”‚ æˆåŠŸ/å¤±è´¥       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 è¿æ¥æ± å®¡è®¡é…ç½®


#### ğŸ“Š HikariCPå®¡è®¡é…ç½®


```java
@Configuration
public class AuditDataSourceConfig {
    
    @Bean
    public DataSource auditDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/testdb");
        config.setUsername("appuser");
        config.setPassword("password");
        
        // è¿æ¥æ± ç›‘æ§é…ç½®
        config.setRegisterMbeans(true);  // å¯ç”¨JMXç›‘æ§
        config.setLeakDetectionThreshold(60000); // è¿æ¥æ³„æ¼æ£€æµ‹
        
        // è‡ªå®šä¹‰è¿æ¥ç”Ÿå‘½å‘¨æœŸç›‘å¬
        config.addDataSourceProperty("connectionInitSql", 
            "SET @connection_id = CONNECTION_ID(), @user_ip = $$hostname");
            
        return new HikariDataSource(config);
    }
    
    // è¿æ¥å®¡è®¡ç›‘å¬å™¨
    @EventListener
    public void handleConnectionEvent(ConnectionEvent event) {
        AuditLog log = AuditLog.builder()
            .timestamp(LocalDateTime.now())
            .eventType(event.getType())
            .connectionId(event.getConnectionId())
            .userInfo(event.getUserInfo())
            .build();
            
        auditLogService.recordLog(log);
    }
}
```

#### ğŸ“Š æ•°æ®åº“çº§åˆ«å®¡è®¡


```sql
-- MySQLå®¡è®¡æ—¥å¿—é…ç½®
SET GLOBAL general_log = 'ON';
SET GLOBAL general_log_file = '/var/log/mysql/general.log';

-- è¿æ¥å®¡è®¡æŸ¥è¯¢
SELECT 
    EVENT_TIME,
    USER_HOST, 
    THREAD_ID,
    SERVER_ID,
    COMMAND_TYPE,
    ARGUMENT
FROM mysql.general_log 
WHERE COMMAND_TYPE IN ('Connect', 'Quit', 'Query')
ORDER BY EVENT_TIME DESC;
```

### 6.3 æ—¥å¿—åˆ†æå’Œç›‘æ§


```java
// æ—¥å¿—åˆ†ææœåŠ¡
@Service
public class ConnectionAuditService {
    
    // æ£€æµ‹å¼‚å¸¸è¿æ¥æ¨¡å¼
    public List<SecurityAlert> detectAnomalies() {
        List<SecurityAlert> alerts = new ArrayList<>();
        
        // 1. æ£€æµ‹é¢‘ç¹è¿æ¥
        List<String> frequentConnectors = auditRepository
            .findFrequentConnections(LocalDateTime.now().minusHours(1), 100);
            
        // 2. æ£€æµ‹å¼‚å¸¸IP
        List<String> suspiciousIPs = auditRepository
            .findUnusualIPConnections(LocalDateTime.now().minusDays(1));
            
        // 3. æ£€æµ‹æƒé™æå‡
        List<String> privilegeEscalations = auditRepository
            .findPrivilegeEscalations(LocalDateTime.now().minusHours(24));
            
        return alerts;
    }
    
    // ç”Ÿæˆå®‰å…¨æŠ¥å‘Š
    public SecurityReport generateReport(LocalDate date) {
        return SecurityReport.builder()
            .totalConnections(auditRepository.countConnections(date))
            .uniqueUsers(auditRepository.countUniqueUsers(date))
            .failedAttempts(auditRepository.countFailedAttempts(date))
            .topQueries(auditRepository.findTopQueries(date, 10))
            .build();
    }
}
```

---

## 7. âš–ï¸ æƒé™æœ€å°åŒ–åŸåˆ™


### 7.1 æœ€å°æƒé™åŸåˆ™æ¦‚å¿µ

**æ ¸å¿ƒæ€æƒ³**ï¼šæ¯ä¸ªç”¨æˆ·å’Œåº”ç”¨åªè·å¾—å®Œæˆå…¶å·¥ä½œæ‰€å¿…éœ€çš„æœ€å°æƒé™ï¼Œå°±åƒç»™å‘˜å·¥å‘æ”¾æœ€å°‘å¤Ÿç”¨çš„é’¥åŒ™ã€‚

```
æƒé™åˆ†é…ç­–ç•¥ï¼š
å…¨éƒ¨æƒé™ âŒ : é£é™©é«˜ï¼Œå½±å“å¤§
          â†“
æŒ‰éœ€åˆ†é… âœ… : é£é™©ä½ï¼Œå¯æ§åˆ¶
          â†“  
å®šæœŸå®¡æŸ¥ âœ… : åŠæ—¶è°ƒæ•´ï¼Œä¿æŒæœ€å°
```

> ğŸ“Œ **æƒé™è®¾è®¡åŸåˆ™**  
> - **èŒèƒ½åˆ†ç¦»**: ä¸åŒè§’è‰²å…·æœ‰ä¸åŒæƒé™
> - **æ—¶é™æ§åˆ¶**: ä¸´æ—¶æƒé™æœ‰æ˜ç¡®æœŸé™  
> - **å®¡æ‰¹æµç¨‹**: æƒé™å˜æ›´éœ€è¦æ‰¹å‡†
> - **å®šæœŸå®¡æŸ¥**: å®šæœŸæ£€æŸ¥æƒé™åˆç†æ€§

### 7.2 æ•°æ®åº“ç”¨æˆ·æƒé™é…ç½®


#### ğŸ“Š MySQLæƒé™åˆ†çº§ç®¡ç†


```sql
-- 1. åº”ç”¨æœåŠ¡ç”¨æˆ·ï¼ˆæœ€å°æƒé™ï¼‰
CREATE USER 'app_service'@'%' IDENTIFIED BY 'strong_password';
GRANT SELECT, INSERT, UPDATE ON myapp.users TO 'app_service'@'%';
GRANT SELECT, INSERT, UPDATE ON myapp.orders TO 'app_service'@'%';
-- ä¸ç»™DELETEæƒé™ï¼Œé¿å…è¯¯åˆ æ•°æ®

-- 2. åªè¯»æŠ¥è¡¨ç”¨æˆ·
CREATE USER 'report_user'@'%' IDENTIFIED BY 'report_password'; 
GRANT SELECT ON myapp.* TO 'report_user'@'%';
-- åªèƒ½æŸ¥è¯¢ï¼Œä¸èƒ½ä¿®æ”¹

-- 3. å¤‡ä»½ç”¨æˆ·
CREATE USER 'backup_user'@'localhost' IDENTIFIED BY 'backup_password';
GRANT SELECT, LOCK TABLES, SHOW VIEW ON *.* TO 'backup_user'@'localhost';
-- åªèƒ½å¤‡ä»½ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®

-- 4. ç®¡ç†å‘˜ç”¨æˆ·ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
CREATE USER 'db_admin'@'localhost' IDENTIFIED BY 'admin_password';
GRANT ALL PRIVILEGES ON *.* TO 'db_admin'@'localhost' WITH GRANT OPTION;
-- åªåœ¨localhostä½¿ç”¨ï¼Œä¸å…è®¸è¿œç¨‹ç®¡ç†
```

#### ğŸ“Š è¿æ¥æ± ç”¨æˆ·é…ç½®


```properties
# ä¸åŒä¸šåŠ¡æ¨¡å—ä½¿ç”¨ä¸åŒæ•°æ®åº“ç”¨æˆ·
# ç”¨æˆ·æ¨¡å—è¿æ¥æ± 
user.datasource.username=user_service
user.datasource.password=${USER_DB_PASSWORD}
user.datasource.url=jdbc:mysql://localhost:3306/myapp

# è®¢å•æ¨¡å—è¿æ¥æ±   
order.datasource.username=order_service
order.datasource.password=${ORDER_DB_PASSWORD}
order.datasource.url=jdbc:mysql://localhost:3306/myapp

# æŠ¥è¡¨æ¨¡å—è¿æ¥æ± ï¼ˆåªè¯»ï¼‰
report.datasource.username=report_user
report.datasource.password=${REPORT_DB_PASSWORD}
report.datasource.url=jdbc:mysql://localhost:3306/myapp
```

### 7.3 åº”ç”¨å±‚æƒé™æ§åˆ¶


```java
// åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶
@Service
public class UserService {
    
    // éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½åˆ›å»ºç”¨æˆ·
    @PreAuthorize("hasRole('ADMIN')")
    public User createUser(UserDto userDto) {
        return userRepository.save(convertToEntity(userDto));
    }
    
    // ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ä¿¡æ¯
    @PreAuthorize("hasRole('USER') and #userId == authentication.name")
    public User getUserById(String userId) {
        return userRepository.findById(userId);
    }
    
    // åªæœ‰ç‰¹å®šè§’è‰²èƒ½åˆ é™¤ç”¨æˆ·
    @PreAuthorize("hasRole('SUPER_ADMIN')")
    public void deleteUser(String userId) {
        userRepository.deleteById(userId);
    }
}

// æ•°æ®æºçº§åˆ«çš„æƒé™æ§åˆ¶
@Configuration
public class DataSourceSecurityConfig {
    
    @Bean
    @Primary
    public DataSource primaryDataSource() {
        // æ™®é€šä¸šåŠ¡æ•°æ®æºï¼Œé™åˆ¶æƒé™
        return createDataSource("app_user", "${APP_PASSWORD}");
    }
    
    @Bean
    @Qualifier("adminDataSource")
    public DataSource adminDataSource() {
        // ç®¡ç†å‘˜æ•°æ®æºï¼Œéœ€è¦ç‰¹æ®Šæƒé™
        return createDataSource("admin_user", "${ADMIN_PASSWORD}");
    }
}
```

---

## 8. ğŸ“‹ å®‰å…¨é…ç½®åŸºçº¿


### 8.1 å®‰å…¨åŸºçº¿æ£€æŸ¥æ¸…å•


> âœ… **è¿æ¥æ± å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•**

#### ğŸ”’ **å¯†ç å®‰å…¨**

- [ ] å¯†ç é‡‡ç”¨ç¯å¢ƒå˜é‡æˆ–åŠ å¯†å­˜å‚¨
- [ ] å¯†ç ç¬¦åˆå¤æ‚æ€§è¦æ±‚ï¼ˆ8ä½ä»¥ä¸Šï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- [ ] å®šæœŸè½®æ¢æ•°æ®åº“å¯†ç ï¼ˆå»ºè®®90å¤©ï¼‰
- [ ] ä¸åœ¨æ—¥å¿—ä¸­è®°å½•å¯†ç ä¿¡æ¯

#### ğŸŒ **è¿æ¥å®‰å…¨**  

- [ ] å¯ç”¨SSL/TLSåŠ å¯†ä¼ è¾“
- [ ] ä½¿ç”¨æ­£å¼CAè¯ä¹¦ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] é…ç½®IPç™½åå•é™åˆ¶
- [ ] ç¦ç”¨ä¸å®‰å…¨çš„ä¼ è¾“åè®®

#### ğŸ‘¤ **æƒé™æ§åˆ¶**

- [ ] éµå¾ªæœ€å°æƒé™åŸåˆ™
- [ ] ä¸åŒä¸šåŠ¡ä½¿ç”¨ä¸åŒæ•°æ®åº“ç”¨æˆ·
- [ ] å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™
- [ ] ç¦ç”¨æˆ–åˆ é™¤ä¸ç”¨çš„æ•°æ®åº“è´¦æˆ·

#### ğŸ“Š **ç›‘æ§å®¡è®¡**

- [ ] å¯ç”¨è¿æ¥å®¡è®¡æ—¥å¿—
- [ ] é…ç½®å¼‚å¸¸è¡Œä¸ºå‘Šè­¦
- [ ] å®šæœŸåˆ†æå®‰å…¨æ—¥å¿—
- [ ] å»ºç«‹å®‰å…¨äº‹ä»¶å“åº”æµç¨‹

### 8.2 ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®æ¨¡æ¿


```yaml
# Spring Bootç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®æ¨¡æ¿
spring:
  datasource:
    hikari:
      # è¿æ¥é…ç½®
      jdbc-url: jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?useSSL=true&requireSSL=true&verifyServerCertificate=true
      username: ${DB_USERNAME}
      password: ${DB_PASSWORD}
      
      # è¿æ¥æ± å®‰å…¨é…ç½®
      maximum-pool-size: 20        # é™åˆ¶æœ€å¤§è¿æ¥æ•°
      minimum-idle: 5              # æœ€å°ç©ºé—²è¿æ¥
      connection-timeout: 30000    # è¿æ¥è¶…æ—¶30ç§’
      idle-timeout: 600000         # ç©ºé—²è¶…æ—¶10åˆ†é’Ÿ
      max-lifetime: 1800000        # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´30åˆ†é’Ÿ
      leak-detection-threshold: 60000  # è¿æ¥æ³„æ¼æ£€æµ‹60ç§’
      
      # å®‰å…¨ç›¸å…³é…ç½®
      register-mbeans: true        # å¯ç”¨JMXç›‘æ§
      connection-init-sql: "SET sql_mode='STRICT_TRANS_TABLES'"
      
  # JPAå®‰å…¨é…ç½®
  jpa:
    show-sql: false               # ç”Ÿäº§ç¯å¢ƒä¸æ˜¾ç¤ºSQL
    properties:
      hibernate:
        format_sql: false         # ä¸æ ¼å¼åŒ–SQLè¾“å‡º
        
# ç›‘æ§é…ç½®        
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics  # åªæš´éœ²å¿…è¦çš„ç«¯ç‚¹
  endpoint:
    health:
      show-details: when-authorized # åªå¯¹æˆæƒç”¨æˆ·æ˜¾ç¤ºè¯¦æƒ…
```

### 8.3 å®‰å…¨æ¼æ´æ£€æŸ¥å·¥å…·


```java
// å®‰å…¨é…ç½®éªŒè¯å·¥å…·
@Component
public class SecurityConfigValidator {
    
    @Value("${spring.datasource.hikari.jdbc-url}")
    private String jdbcUrl;
    
    @PostConstruct
    public void validateSecurityConfig() {
        List<String> violations = new ArrayList<>();
        
        // æ£€æŸ¥SSLé…ç½®
        if (!jdbcUrl.contains("useSSL=true")) {
            violations.add("SSLæœªå¯ç”¨");
        }
        
        if (!jdbcUrl.contains("requireSSL=true")) {
            violations.add("æœªå¼ºåˆ¶è¦æ±‚SSL");
        }
        
        // æ£€æŸ¥å¯†ç é…ç½®
        if (isPasswordHardcoded()) {
            violations.add("å¯†ç ç¡¬ç¼–ç åœ¨é…ç½®æ–‡ä»¶ä¸­");
        }
        
        // è¾“å‡ºæ£€æŸ¥ç»“æœ
        if (!violations.isEmpty()) {
            log.error("å‘ç°å®‰å…¨é…ç½®é—®é¢˜: {}", violations);
            throw new SecurityConfigurationException("å®‰å…¨é…ç½®éªŒè¯å¤±è´¥");
        }
        
        log.info("å®‰å…¨é…ç½®éªŒè¯é€šè¿‡");
    }
    
    private boolean isPasswordHardcoded() {
        // æ£€æŸ¥å¯†ç æ˜¯å¦ä¸ºç¯å¢ƒå˜é‡
        String password = environment.getProperty("spring.datasource.password");
        return password != null && !password.startsWith("${");
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„å®‰å…¨æ¦‚å¿µ


```
ğŸ”¸ è¿æ¥æ± å®‰å…¨æœ¬è´¨ï¼šä¿æŠ¤æ•°æ®åº“è¿æ¥å…¨ç”Ÿå‘½å‘¨æœŸçš„å®‰å…¨
ğŸ”¸ åŠ å¯†ä¼ è¾“ï¼šä½¿ç”¨SSL/TLSç¡®ä¿æ•°æ®ä¼ è¾“å®‰å…¨  
ğŸ”¸ å¯†ç ä¿æŠ¤ï¼šç¯å¢ƒå˜é‡+åŠ å¯†å­˜å‚¨ï¼Œç»ä¸ç¡¬ç¼–ç 
ğŸ”¸ è®¿é—®æ§åˆ¶ï¼šåŸºäºè§’è‰²å’ŒIPçš„å¤šå±‚è®¿é—®æ§åˆ¶
ğŸ”¸ æƒé™æœ€å°åŒ–ï¼šåªç»™å¿…éœ€çš„æœ€å°æƒé™
ğŸ”¸ å®¡è®¡ç›‘æ§ï¼šå®Œæ•´è®°å½•å’Œåˆ†ææ‰€æœ‰è¿æ¥è¡Œä¸º
```

### 9.2 å…³é”®å®‰å…¨å®è·µ


**ğŸ”¹ å¯†ç ç®¡ç†æœ€ä½³å®è·µ**
```
ç¯å¢ƒå˜é‡å­˜å‚¨ â†’ é¿å…ç¡¬ç¼–ç æ³„éœ²
å®šæœŸè½®æ¢å¯†ç  â†’ é™ä½é•¿æœŸæš´éœ²é£é™©  
å¼ºå¯†ç ç­–ç•¥ â†’ æé«˜ç ´è§£éš¾åº¦
åŠ å¯†é…ç½®æ–‡ä»¶ â†’ ä¿æŠ¤é…ç½®ä¿¡æ¯å®‰å…¨
```

**ğŸ”¹ è¿æ¥å®‰å…¨å¼ºåŒ–**
```
å¼ºåˆ¶SSLè¿æ¥ â†’ é˜²æ­¢ä¸­é—´äººæ”»å‡»
è¯ä¹¦éªŒè¯ â†’ ç¡®ä¿æœåŠ¡å™¨èº«ä»½çœŸå®
IPç™½åå• â†’ é™åˆ¶è®¿é—®æ¥æº
è¿æ¥è¶…æ—¶ â†’ é¿å…é•¿æ—¶é—´å ç”¨èµ„æº
```

**ğŸ”¹ æƒé™æ§åˆ¶ç­–ç•¥**  
```
æœ€å°æƒé™åŸåˆ™ â†’ é™ä½æƒé™æ»¥ç”¨é£é™©
è§’è‰²åˆ†ç¦» â†’ ä¸åŒèŒèƒ½ä¸åŒæƒé™
å®šæœŸå®¡æŸ¥ â†’ åŠæ—¶æ¸…ç†æ— ç”¨æƒé™  
æƒé™å®¡æ‰¹ â†’ å˜æ›´éœ€è¦åˆè§„æµç¨‹
```

### 9.3 å®‰å…¨é…ç½®è®°å¿†è¦ç‚¹


> ğŸ“– **å®‰å…¨é…ç½®è®°å¿†å£è¯€**  
> å¯†ç åŠ å¯†ä¸ç¡¬ç¼–ï¼ŒSSLè¿æ¥è¦éªŒè¯  
> æœ€å°æƒé™æŒ‰éœ€ç»™ï¼Œå®¡è®¡æ—¥å¿—å…¨è®°å½•  
> IPç™½åå•æ§è®¿é—®ï¼Œå®šæœŸæ£€æŸ¥é™¤éšæ‚£

**ğŸ¯ ç”Ÿäº§ç¯å¢ƒå¿…æ£€é¡¹**
- âœ… SSLå¼ºåˆ¶å¯ç”¨ä¸”è¯ä¹¦æœ‰æ•ˆ
- âœ… å¯†ç é€šè¿‡ç¯å¢ƒå˜é‡æä¾›  
- âœ… è¿æ¥æ± å‚æ•°åˆç†é…ç½®
- âœ… å®¡è®¡æ—¥å¿—æ­£å¸¸è®°å½•
- âœ… æƒé™éµå¾ªæœ€å°åŒ–åŸåˆ™
- âœ… å®‰å…¨ç›‘æ§å‘Šè­¦æ­£å¸¸

**ğŸš¨ å¸¸è§å®‰å…¨è¯¯åŒº**
- âŒ ä¸ºäº†æ–¹ä¾¿æŠŠå¯†ç å†™åœ¨é…ç½®æ–‡ä»¶é‡Œ
- âŒ è§‰å¾—å†…ç½‘ç¯å¢ƒä¸éœ€è¦SSLåŠ å¯†
- âŒ ç»™åº”ç”¨è´¦æˆ·è¿‡å¤šæ•°æ®åº“æƒé™
- âŒ å¿½ç•¥è¿æ¥æ± çš„å®‰å…¨æ—¥å¿—è®°å½•
- âŒ é•¿æœŸä¸æ›´æ¢æ•°æ®åº“å¯†ç 

**æ ¸å¿ƒç†å¿µ**ï¼šå®‰å…¨é…ç½®ä¸æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼Œè€Œæ˜¯éœ€è¦æŒç»­å…³æ³¨å’Œæ”¹è¿›çš„è¿‡ç¨‹ã€‚é˜²æ‚£äºæœªç„¶ï¼Œæ°¸è¿œæ¯”äº¡ç¾Šè¡¥ç‰¢è¦å¥½ã€‚