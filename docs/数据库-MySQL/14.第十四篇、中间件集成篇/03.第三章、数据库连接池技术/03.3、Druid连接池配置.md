---
title: 3ã€Druidè¿æ¥æ± é…ç½®
---
## ğŸ“š ç›®å½•

1. [Druidè¿æ¥æ± æ¦‚è¿°](#1-druidè¿æ¥æ± æ¦‚è¿°)
2. [åŸºç¡€é…ç½®è¯¦è§£](#2-åŸºç¡€é…ç½®è¯¦è§£)
3. [ç›‘æ§åŠŸèƒ½é…ç½®](#3-ç›‘æ§åŠŸèƒ½é…ç½®)
4. [å®‰å…¨é˜²æŠ¤é…ç½®](#4-å®‰å…¨é˜²æŠ¤é…ç½®)
5. [æ€§èƒ½ä¼˜åŒ–é…ç½®](#5-æ€§èƒ½ä¼˜åŒ–é…ç½®)
6. [Spring Booté›†æˆ](#6-spring-booté›†æˆ)
7. [ç›‘æ§é¡µé¢å®šåˆ¶](#7-ç›‘æ§é¡µé¢å®šåˆ¶)
8. [ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ](#8-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ Druidè¿æ¥æ± æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Druidè¿æ¥æ± 


**ç®€å•ç†è§£**ï¼šDruidæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„æ•°æ®åº“è¿æ¥æ± ï¼Œå°±åƒåœè½¦åœºç®¡ç†ç³»ç»Ÿä¸€æ ·ï¼Œç»Ÿä¸€ç®¡ç†æ•°æ®åº“è¿æ¥ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆæ²¡æœ‰è¿æ¥æ± ï¼‰ï¼š
æ¯æ¬¡æŸ¥æ•°æ®åº“ â†’ æ–°å»ºè¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å…³é—­è¿æ¥
é—®é¢˜ï¼šé¢‘ç¹å»ºç«‹å’Œå…³é—­è¿æ¥å¾ˆè€—è´¹èµ„æº

Druidè¿æ¥æ± æ–¹å¼ï¼š
å¯åŠ¨æ—¶ â†’ é¢„å…ˆåˆ›å»ºå¤šä¸ªè¿æ¥æ”¾åœ¨"æ± å­"é‡Œ
æŸ¥æ•°æ®åº“æ—¶ â†’ ä»æ± å­å€Ÿä¸€ä¸ªè¿æ¥ â†’ ç”¨å®Œè¿˜å›æ± å­
ä¼˜åŠ¿ï¼šè¿æ¥å¤ç”¨ï¼Œæ€§èƒ½å¤§å¹…æå‡
```

### 1.2 Druidçš„æ ¸å¿ƒä¼˜åŠ¿


**ä¸ºä»€ä¹ˆé€‰æ‹©Druid**ï¼š

| ç‰¹æ€§ | **è¯´æ˜** | **å®é™…ä»·å€¼** |
|------|----------|-------------|
| ğŸ” **å¼ºå¤§ç›‘æ§** | `å®æ—¶ç›‘æ§SQLæ‰§è¡Œæƒ…å†µ` | `å¿«é€Ÿå‘ç°æ…¢SQLå’Œå¼‚å¸¸` |
| ğŸ›¡ï¸ **SQLé˜²ç«å¢™** | `è‡ªåŠ¨é˜»æ­¢å±é™©SQLè¯­å¥` | `é˜²æ­¢SQLæ³¨å…¥æ”»å‡»` |
| ğŸ”§ **è¿æ¥ç®¡ç†** | `æ™ºèƒ½æ£€æµ‹è¿æ¥å¥åº·çŠ¶æ€` | `é¿å…è¿æ¥æ³„æ¼é—®é¢˜` |
| ğŸ“Š **Webç•Œé¢** | `å›¾å½¢åŒ–ç›‘æ§é¢æ¿` | `è¿ç»´äººå‘˜ç›´è§‚æŸ¥çœ‹çŠ¶æ€` |
| âš¡ **æ€§èƒ½ä¼˜åŒ–** | `PSCacheç­‰ç¼“å­˜æœºåˆ¶` | `æå‡æŸ¥è¯¢æ‰§è¡Œæ•ˆç‡` |

---

## 2. âš™ï¸ åŸºç¡€é…ç½®è¯¦è§£


### 2.1 æ ¸å¿ƒè¿æ¥å‚æ•°


**æœ€åŸºæœ¬çš„é…ç½®ç†è§£**ï¼š

```yaml
# application.yml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      # æ•°æ®åº“è¿æ¥ä¿¡æ¯
      url: jdbc:mysql://localhost:3306/mydb?useUnicode=true&characterEncoding=utf8
      username: root
      password: your_password
      driver-class-name: com.mysql.cj.jdbc.Driver
      
      # è¿æ¥æ± æ ¸å¿ƒå‚æ•°
      initial-size: 5        # å¯åŠ¨æ—¶åˆ›å»º5ä¸ªè¿æ¥
      min-idle: 5           # æ± ä¸­æœ€å°‘ä¿æŒ5ä¸ªè¿æ¥
      max-active: 20        # æ± ä¸­æœ€å¤š20ä¸ªè¿æ¥
      max-wait: 60000       # è·å–è¿æ¥æœ€å¤šç­‰å¾…60ç§’
```

**å‚æ•°å«ä¹‰è¯¦è§£**ï¼š

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šæŠŠè¿æ¥æ± æƒ³è±¡æˆä¸€ä¸ªåœè½¦åœº
> - `initial-size`ï¼šåœè½¦åœºå¼€ä¸šæ—¶é¢„ç•™çš„è½¦ä½æ•°
> - `min-idle`ï¼šæ— è®ºå¤šé—²ï¼Œè‡³å°‘ä¿è¯æœ‰å‡ ä¸ªç©ºè½¦ä½
> - `max-active`ï¼šåœè½¦åœºæœ€å¤šèƒ½åœå¤šå°‘è¾†è½¦
> - `max-wait`ï¼šè½¦ä¸»æœ€å¤šç­‰å¤šä¹…æ‰èƒ½è¿›å…¥åœè½¦åœº

### 2.2 è¿æ¥å¥åº·æ£€æµ‹


**ä¸ºä»€ä¹ˆéœ€è¦æ£€æµ‹**ï¼šæ•°æ®åº“è¿æ¥å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜ã€è¶…æ—¶ç­‰åŸå› å˜æˆ"åƒµå°¸è¿æ¥"ï¼Œå°±åƒåœè½¦åœºé‡Œçš„åƒµå°¸è½¦ä½ã€‚

```yaml
spring:
  datasource:
    druid:
      # è¿æ¥å¥åº·æ£€æµ‹é…ç½®
      test-while-idle: true                    # ç©ºé—²æ—¶æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆ
      test-on-borrow: false                   # å€Ÿç”¨è¿æ¥æ—¶ä¸æ£€æµ‹ï¼ˆå½±å“æ€§èƒ½ï¼‰
      test-on-return: false                   # å½’è¿˜è¿æ¥æ—¶ä¸æ£€æµ‹
      validation-query: SELECT 1             # ç”¨æ¥æµ‹è¯•è¿æ¥çš„SQLè¯­å¥
      validation-query-timeout: 30           # æ£€æµ‹è¶…æ—¶æ—¶é—´30ç§’
      
      # æ¸…ç†æ— æ•ˆè¿æ¥
      time-between-eviction-runs-millis: 60000  # æ¯60ç§’æ£€æŸ¥ä¸€æ¬¡
      min-evictable-idle-time-millis: 300000    # è¿æ¥ç©ºé—²5åˆ†é’Ÿå°±æ¸…ç†
```

**ğŸ” å…³é”®ç†è§£**ï¼š
- `test-while-idle: true`ï¼šå®šæœŸæ£€æŸ¥æ± ä¸­ç©ºé—²è¿æ¥æ˜¯å¦è¿˜èƒ½ç”¨
- `validation-query: SELECT 1`ï¼šæœ€ç®€å•çš„æµ‹è¯•è¯­å¥ï¼Œæ£€æŸ¥æ•°æ®åº“æ˜¯å¦å“åº”
- æ¸…ç†æœºåˆ¶ï¼šè‡ªåŠ¨ç§»é™¤å¤±æ•ˆè¿æ¥ï¼Œä¿æŒè¿æ¥æ± å¥åº·

---

## 3. ğŸ“Š ç›‘æ§åŠŸèƒ½é…ç½®


### 3.1 StatFilterç»Ÿè®¡è¿‡æ»¤å™¨


**ä½œç”¨è¯´æ˜**ï¼šStatFilterå°±åƒç»™æ•°æ®åº“æ“ä½œè£…äº†ä¸€ä¸ª"è®°å½•ä»ª"ï¼Œè®°å½•æ¯æ¡SQLçš„æ‰§è¡Œæƒ…å†µã€‚

```yaml
spring:
  datasource:
    druid:
      # å¯ç”¨ç»Ÿè®¡åŠŸèƒ½
      filters: stat,wall,log4j2
      
      # StatFilterè¯¦ç»†é…ç½®
      filter:
        stat:
          enabled: true
          slow-sql-millis: 1000      # æ‰§è¡Œè¶…è¿‡1ç§’çš„SQLè®°ä¸ºæ…¢SQL
          log-slow-sql: true         # æŠŠæ…¢SQLæ‰“å°åˆ°æ—¥å¿—
          merge-sql: true            # åˆå¹¶ç›¸ä¼¼SQLç»Ÿè®¡
```

**ğŸ¯ ç›‘æ§æ•°æ®åŒ…å«**ï¼š
- **SQLæ‰§è¡Œæ¬¡æ•°**ï¼šå“ªäº›SQLè¢«è°ƒç”¨å¾—æœ€é¢‘ç¹
- **æ‰§è¡Œæ—¶é—´ç»Ÿè®¡**ï¼šå¹³å‡è€—æ—¶ã€æœ€å¤§è€—æ—¶ã€æœ€å°è€—æ—¶
- **æ…¢SQLè®°å½•**ï¼šè¶…è¿‡è®¾å®šæ—¶é—´çš„SQLè¯­å¥
- **é”™è¯¯ç»Ÿè®¡**ï¼šSQLæ‰§è¡Œå¤±è´¥çš„æ¬¡æ•°å’ŒåŸå› 

### 3.2 Webç›‘æ§ç•Œé¢é…ç½®


**åŠŸèƒ½è¯´æ˜**ï¼šæä¾›ä¸€ä¸ªç½‘é¡µç•Œé¢ï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹æ•°æ®åº“è¿æ¥æ± çŠ¶æ€ï¼Œå°±åƒæ±½è½¦ä»ªè¡¨ç›˜ä¸€æ ·ã€‚

```java
@Configuration
public class DruidConfig {
    
    /**
     * é…ç½®Druidç›‘æ§é¡µé¢
     */
    @Bean
    public ServletRegistrationBean<StatViewServlet> druidStatViewServlet() {
        ServletRegistrationBean<StatViewServlet> bean = 
            new ServletRegistrationBean<>(new StatViewServlet(), "/druid/*");
        
        // ç›‘æ§é¡µé¢ç™»å½•é…ç½®
        Map<String, String> params = new HashMap<>();
        params.put("loginUsername", "admin");        // ç™»å½•ç”¨æˆ·å
        params.put("loginPassword", "admin123");     // ç™»å½•å¯†ç 
        params.put("allow", "127.0.0.1");          // å…è®¸è®¿é—®çš„IP
        params.put("deny", "");                     // ç¦æ­¢è®¿é—®çš„IPï¼ˆä¸ºç©ºè¡¨ç¤ºä¸ç¦æ­¢ï¼‰
        
        bean.setInitParameters(params);
        return bean;
    }
}
```

**ğŸ“ˆ ç›‘æ§é¡µé¢åŠŸèƒ½**ï¼š
- è®¿é—®åœ°å€ï¼š`http://localhost:8080/druid/index.html`
- **æ•°æ®æºé¡µé¢**ï¼šè¿æ¥æ± çŠ¶æ€ã€æ´»è·ƒè¿æ¥æ•°ã€ç©ºé—²è¿æ¥æ•°
- **SQLç›‘æ§é¡µé¢**ï¼šæ‰€æœ‰SQLè¯­å¥çš„æ‰§è¡Œç»Ÿè®¡
- **URLç›‘æ§é¡µé¢**ï¼šWebè¯·æ±‚çš„è®¿é—®ç»Ÿè®¡
- **Sessionç›‘æ§é¡µé¢**ï¼šç”¨æˆ·ä¼šè¯ç»Ÿè®¡

---

## 4. ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤é…ç½®


### 4.1 SQLé˜²ç«å¢™ï¼ˆWallFilterï¼‰


**ä½œç”¨åŸç†**ï¼šå°±åƒç½‘ç»œé˜²ç«å¢™ä¸€æ ·ï¼ŒWallFilterä¼šæ£€æŸ¥æ¯æ¡SQLè¯­å¥ï¼Œé˜»æ­¢å±é™©çš„SQLæ“ä½œã€‚

```yaml
spring:
  datasource:
    druid:
      filter:
        wall:
          enabled: true
          config:
            # åŸºç¡€å®‰å…¨é…ç½®
            select-allow: true           # å…è®¸SELECTè¯­å¥
            delete-allow: true           # å…è®¸DELETEè¯­å¥
            update-allow: true           # å…è®¸UPDATEè¯­å¥
            drop-table-allow: false      # ç¦æ­¢DROP TABLEï¼ˆåˆ è¡¨æ“ä½œï¼‰
            
            # é˜²æ­¢SQLæ³¨å…¥
            multiStatementAllow: false   # ç¦æ­¢æ‰¹é‡SQLè¯­å¥
            noneBaseStatementAllow: false # ç¦æ­¢éåŸºç¡€è¯­å¥
```

**ğŸš¨ å¸¸è§æ”»å‡»é˜²æŠ¤**ï¼š

```sql
-- ä»¥ä¸‹å±é™©SQLä¼šè¢«è‡ªåŠ¨é˜»æ­¢ï¼š

-- 1. SQLæ³¨å…¥æ”»å‡»
SELECT * FROM users WHERE id = '1 OR 1=1'

-- 2. åˆ è¡¨æ“ä½œ
DROP TABLE users;

-- 3. æ‰¹é‡æ¶æ„æ“ä½œ
DELETE FROM users; UPDATE orders SET status='cancelled';
```

### 4.2 æ•°æ®åº“å¯†ç åŠ å¯†


**å®‰å…¨é—®é¢˜**ï¼šé…ç½®æ–‡ä»¶ä¸­æ˜æ–‡å¯†ç å®¹æ˜“æ³„éœ²ï¼Œéœ€è¦åŠ å¯†å­˜å‚¨ã€‚

```java
// 1. ç”ŸæˆåŠ å¯†å¯†ç çš„å·¥å…·ç±»
public class PasswordEncryptor {
    public static void main(String[] args) throws Exception {
        String password = "your_real_password";
        
        // ä½¿ç”¨Druidæä¾›çš„åŠ å¯†å·¥å…·
        String[] arr = ConfigTools.genKeyPair(512);
        System.out.println("privateKey: " + arr[0]);
        System.out.println("publicKey: " + arr[1]);
        System.out.println("encryptedPassword: " + 
                          ConfigTools.encrypt(arr[0], password));
    }
}
```

```yaml
# é…ç½®æ–‡ä»¶ä½¿ç”¨åŠ å¯†å¯†ç 
spring:
  datasource:
    druid:
      password: åŠ å¯†åçš„å¯†ç å­—ç¬¦ä¸²
      filter:
        config:
          enabled: true
      connection-properties: config.decrypt=true;config.decrypt.key=å…¬é’¥å­—ç¬¦ä¸²
```

---

## 5. âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®


### 5.1 PSCacheé¢„ç¼–è¯‘ç¼“å­˜


**ç¼“å­˜åŸç†**ï¼šæ•°æ®åº“æ¯æ¬¡æ‰§è¡ŒSQLéƒ½è¦ç¼–è¯‘ï¼ŒPSCacheæŠŠç¼–è¯‘ç»“æœç¼“å­˜èµ·æ¥ï¼Œé¿å…é‡å¤ç¼–è¯‘ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
SQLè¯­å¥ â†’ è§£æ â†’ ç¼–è¯‘ â†’ æ‰§è¡Œï¼ˆæ¯æ¬¡éƒ½è¦ç¼–è¯‘ï¼‰

PSCacheæ–¹å¼ï¼š
SQLè¯­å¥ â†’ æ£€æŸ¥ç¼“å­˜ â†’ å¦‚æœæœ‰ç¼“å­˜ç›´æ¥æ‰§è¡Œï¼Œæ²¡æœ‰åˆ™ç¼–è¯‘åç¼“å­˜
```

```yaml
spring:
  datasource:
    druid:
      # PSCacheé…ç½®
      pool-prepared-statements: true     # å¯ç”¨PSCache
      max-pool-prepared-statement-per-connection-size: 20  # æ¯ä¸ªè¿æ¥æœ€å¤šç¼“å­˜20ä¸ªé¢„ç¼–è¯‘è¯­å¥
      max-open-prepared-statements: 100  # å…¨å±€æœ€å¤šç¼“å­˜100ä¸ªé¢„ç¼–è¯‘è¯­å¥
```

### 5.2 è¿æ¥æ³„æ¼æ£€æµ‹


**ä»€ä¹ˆæ˜¯è¿æ¥æ³„æ¼**ï¼šç¨‹åºæ‹¿åˆ°æ•°æ®åº“è¿æ¥åå¿˜è®°å½’è¿˜ï¼Œå°±åƒå€Ÿä¹¦ä¸è¿˜ä¸€æ ·ã€‚

```yaml
spring:
  datasource:
    druid:
      # è¿æ¥æ³„æ¼æ£€æµ‹
      remove-abandoned: true          # å¯ç”¨æ³„æ¼æ£€æµ‹
      remove-abandoned-timeout: 1800  # è¿æ¥ä½¿ç”¨è¶…è¿‡30åˆ†é’Ÿè®¤ä¸ºæ³„æ¼
      log-abandoned: true             # è®°å½•æ³„æ¼æ—¥å¿—
```

**ğŸ”§ æ£€æµ‹æœºåˆ¶**ï¼š
- ç³»ç»Ÿä¼šè·Ÿè¸ªæ¯ä¸ªè¿æ¥çš„ä½¿ç”¨æ—¶é—´
- è¶…è¿‡è®¾å®šæ—¶é—´æœªå½’è¿˜çš„è¿æ¥ä¼šè¢«å¼ºåˆ¶å›æ”¶
- åŒæ—¶è®°å½•æ—¥å¿—ï¼Œå¸®åŠ©å¼€å‘è€…å®šä½é—®é¢˜ä»£ç 

---

## 6. ğŸŒ± Spring Booté›†æˆ


### 6.1 ä¾èµ–é…ç½®


```xml
<dependencies>
    <!-- Druidè¿æ¥æ±  -->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid-spring-boot-starter</artifactId>
        <version>1.2.18</version>
    </dependency>
    
    <!-- MySQLé©±åŠ¨ -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>
</dependencies>
```

### 6.2 å®Œæ•´é…ç½®ç¤ºä¾‹


```yaml
# application.yml ç”Ÿäº§ç¯å¢ƒé…ç½®
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      # æ•°æ®åº“è¿æ¥é…ç½®
      url: jdbc:mysql://localhost:3306/mydb?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
      username: ${DB_USERNAME:root}
      password: ${DB_PASSWORD:password}
      driver-class-name: com.mysql.cj.jdbc.Driver
      
      # è¿æ¥æ± é…ç½®
      initial-size: 10
      min-idle: 10
      max-active: 50
      max-wait: 60000
      
      # å¥åº·æ£€æµ‹
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      validation-query: SELECT 1
      validation-query-timeout: 30
      
      # æ¸…ç†é…ç½®
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      
      # è¿‡æ»¤å™¨é…ç½®
      filters: stat,wall,slf4j
      
      # ç›‘æ§é…ç½®
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: "*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"
        
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        login-username: admin
        login-password: admin123
        allow: 127.0.0.1
```

---

## 7. ğŸ¨ ç›‘æ§é¡µé¢å®šåˆ¶


### 7.1 è‡ªå®šä¹‰è¿‡æ»¤å™¨


```java
@Component
public class CustomDruidFilter extends FilterEventAdapter {
    
    private static final Logger logger = LoggerFactory.getLogger(CustomDruidFilter.class);
    
    @Override
    protected void statementExecuteAfter(StatementProxy statement, String sql, boolean result) {
        // è‡ªå®šä¹‰SQLæ‰§è¡Œåçš„å¤„ç†
        long executeTime = statement.getLastExecuteTimeNano() / 1000000; // è½¬æ¢ä¸ºæ¯«ç§’
        
        if (executeTime > 5000) { // è¶…è¿‡5ç§’çš„SQL
            logger.warn("æ£€æµ‹åˆ°è¶…æ…¢SQLï¼Œæ‰§è¡Œæ—¶é—´: {}ms, SQL: {}", executeTime, sql);
            
            // å¯ä»¥å‘é€å‘Šè­¦ã€è®°å½•åˆ°ç‰¹æ®Šæ—¥å¿—ç­‰
            sendSlowSqlAlert(sql, executeTime);
        }
    }
    
    private void sendSlowSqlAlert(String sql, long executeTime) {
        // å®ç°å‘Šè­¦é€»è¾‘ï¼šå‘é‚®ä»¶ã€å‘çŸ­ä¿¡ã€è°ƒç”¨é’‰é’‰APIç­‰
        System.out.println("ğŸš¨ æ…¢SQLå‘Šè­¦: " + sql + " è€—æ—¶: " + executeTime + "ms");
    }
}
```

### 7.2 JMXç›‘æ§é›†æˆ


```java
@Configuration
public class DruidJMXConfig {
    
    @Bean
    public MBeanExporter druidMBeanExporter() {
        MBeanExporter exporter = new MBeanExporter();
        
        // å°†Druidè¿æ¥æ± ä¿¡æ¯æš´éœ²ç»™JMX
        Map<String, Object> beans = new HashMap<>();
        beans.put("druid:type=DruidDataSource", dataSource());
        
        exporter.setBeans(beans);
        return exporter;
    }
    
    @Bean
    @Primary
    public DruidDataSource dataSource() {
        return new DruidDataSource();
    }
}
```

---

## 8. ğŸ­ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


### 8.1 è¿æ¥æ± å‚æ•°è°ƒä¼˜æŒ‡å—


```yaml
# ä¸åŒåº”ç”¨è§„æ¨¡çš„æ¨èé…ç½®

# å°å‹åº”ç”¨ï¼ˆæ—¥æ´» < 1ä¸‡ï¼‰
small-app:
  initial-size: 5
  min-idle: 5
  max-active: 20
  max-wait: 30000

# ä¸­å‹åº”ç”¨ï¼ˆæ—¥æ´» 1-10ä¸‡ï¼‰
medium-app:
  initial-size: 10
  min-idle: 10
  max-active: 50
  max-wait: 60000

# å¤§å‹åº”ç”¨ï¼ˆæ—¥æ´» > 10ä¸‡ï¼‰
large-app:
  initial-size: 20
  min-idle: 20
  max-active: 100
  max-wait: 30000
```

**ğŸ¯ è°ƒä¼˜ç­–ç•¥**ï¼š

> ğŸ“ **ç»éªŒæ€»ç»“**ï¼š
> 1. **åˆå§‹è¿æ¥æ•°**ï¼šè®¾ä¸ºé¢„æœŸå¹¶å‘æ•°çš„ 20-30%
> 2. **æœ€å¤§è¿æ¥æ•°**ï¼šè®¾ä¸ºæ•°æ®åº“æœ€å¤§è¿æ¥æ•°çš„ 80%
> 3. **ç­‰å¾…æ—¶é—´**ï¼šwebåº”ç”¨å»ºè®® 30-60ç§’
> 4. **ç›‘æ§æŒ‡æ ‡**ï¼šé‡ç‚¹å…³æ³¨æ´»è·ƒè¿æ¥æ•°å’Œç­‰å¾…æ—¶é—´

### 8.2 ç›‘æ§å‘Šè­¦é…ç½®


```java
@Component
public class DruidMonitoringService {
    
    @Autowired
    private DruidDataSource dataSource;
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void checkConnectionPool() {
        DruidDataSourceStatManager manager = DruidDataSourceStatManager.getInstance();
        
        for (DruidDataSourceStatValue stat : manager.getDataSourceStatDataList()) {
            // æ£€æŸ¥æ´»è·ƒè¿æ¥æ•°
            if (stat.getActiveCount() > stat.getMaxActive() * 0.8) {
                logger.warn("è¿æ¥æ± ä½¿ç”¨ç‡è¿‡é«˜: {}/{}", 
                           stat.getActiveCount(), stat.getMaxActive());
            }
            
            // æ£€æŸ¥ç­‰å¾…çº¿ç¨‹æ•°
            if (stat.getNotEmptyWaitCount() > 10) {
                logger.warn("è¿æ¥æ± ç­‰å¾…çº¿ç¨‹è¿‡å¤š: {}", stat.getNotEmptyWaitCount());
            }
        }
    }
}
```

### 8.3 å®‰å…¨é…ç½®æ¸…å•


```yaml
# ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•
security-checklist:
  âœ… æ•°æ®åº“å¯†ç åŠ å¯†
  âœ… ç›‘æ§é¡µé¢è®¿é—®æ§åˆ¶
  âœ… SQLé˜²ç«å¢™å¼€å¯
  âœ… åˆ è¡¨ç­‰å±é™©æ“ä½œç¦ç”¨
  âœ… è¿æ¥æ³„æ¼æ£€æµ‹å¼€å¯
  âœ… æ…¢SQLç›‘æ§å¼€å¯
  âœ… è®¿é—®æ—¥å¿—è®°å½•
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Druidæœ¬è´¨ï¼šé˜¿é‡Œå¼€æºçš„åŠŸèƒ½å¼ºå¤§çš„æ•°æ®åº“è¿æ¥æ± 
ğŸ”¸ æ ¸å¿ƒä¼˜åŠ¿ï¼šç›‘æ§ã€é˜²æŠ¤ã€æ€§èƒ½ä¼˜åŒ–ä¸‰ä½ä¸€ä½“
ğŸ”¸ é…ç½®æ ¸å¿ƒï¼šè¿æ¥å‚æ•°ã€è¿‡æ»¤å™¨ã€ç›‘æ§ç•Œé¢
ğŸ”¸ å®‰å…¨é‡ç‚¹ï¼šSQLé˜²ç«å¢™ã€å¯†ç åŠ å¯†ã€è®¿é—®æ§åˆ¶
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šPSCacheã€è¿æ¥æ£€æµ‹ã€å‚æ•°è°ƒä¼˜
```

### 9.2 å…³é”®é…ç½®ç†è§£


**ğŸ”¹ è¿æ¥æ± æ ¸å¿ƒå‚æ•°**ï¼š
```
åˆå§‹è¿æ¥æ•° â†’ åº”ç”¨å¯åŠ¨æ—¶çš„è¿æ¥é¢„ç•™
æœ€å°ç©ºé—²æ•° â†’ ä¿è¯éšæ—¶å¯ç”¨çš„è¿æ¥
æœ€å¤§è¿æ¥æ•° â†’ é˜²æ­¢è¿æ¥æ•°æ— é™å¢é•¿
ç­‰å¾…è¶…æ—¶ â†’ é¿å…è¯·æ±‚æ— é™ç­‰å¾…
```

**ğŸ”¹ è¿‡æ»¤å™¨ä½œç”¨æœºåˆ¶**ï¼š
```
StatFilter â†’ ç»Ÿè®¡SQLæ‰§è¡Œæƒ…å†µ
WallFilter â†’ é˜²æ­¢SQLæ³¨å…¥æ”»å‡»  
LogFilter â†’ è®°å½•æ•°æ®åº“æ“ä½œæ—¥å¿—
```

**ğŸ”¹ ç›‘æ§æ•°æ®ä»·å€¼**ï¼š
```
æ…¢SQLè¯†åˆ« â†’ æ€§èƒ½ä¼˜åŒ–ä¾æ®
è¿æ¥ä½¿ç”¨ç‡ â†’ å®¹é‡è§„åˆ’å‚è€ƒ
å¼‚å¸¸ç»Ÿè®¡ â†’ æ•…éšœè¯Šæ–­çº¿ç´¢
```

### 9.3 ç”Ÿäº§åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é€‰æ‹©Druidçš„åœºæ™¯**ï¼š
- âœ… éœ€è¦è¯¦ç»†çš„SQLç›‘æ§æ•°æ®
- âœ… å¯¹æ•°æ®åº“å®‰å…¨è¦æ±‚è¾ƒé«˜
- âœ… å¸Œæœ›æœ‰å¯è§†åŒ–ç›‘æ§ç•Œé¢
- âœ… éœ€è¦è¿æ¥æ± çš„æ‰©å±•åŠŸèƒ½

**âš™ï¸ é…ç½®è°ƒä¼˜åŸåˆ™**ï¼š
1. **æ ¹æ®ä¸šåŠ¡é‡è°ƒæ•´è¿æ¥æ± å¤§å°**
2. **å¼€å¯å¿…è¦çš„ç›‘æ§å’Œå‘Šè­¦**
3. **é…ç½®é€‚å½“çš„å®‰å…¨é˜²æŠ¤è§„åˆ™**
4. **å®šæœŸåˆ†æç›‘æ§æ•°æ®ä¼˜åŒ–æ€§èƒ½**

**ğŸ›¡ï¸ å®‰å…¨é…ç½®è¦ç‚¹**ï¼š
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»åŠ å¯†æ•°æ®åº“å¯†ç 
- é™åˆ¶ç›‘æ§é¡µé¢çš„è®¿é—®IPèŒƒå›´
- å¼€å¯SQLé˜²ç«å¢™é˜²æ­¢æ³¨å…¥æ”»å‡»
- é…ç½®è¿æ¥æ³„æ¼æ£€æµ‹é¿å…èµ„æºæ³„éœ²

**æ ¸å¿ƒè®°å¿†**ï¼š
- Druidä¸ä»…æ˜¯è¿æ¥æ± ï¼Œæ›´æ˜¯æ•°æ®åº“ç›‘æ§å’Œå®‰å…¨é˜²æŠ¤çš„ç»¼åˆè§£å†³æ–¹æ¡ˆ
- åˆç†é…ç½®èƒ½æ˜¾è‘—æå‡åº”ç”¨æ€§èƒ½å’Œå®‰å…¨æ€§
- ç›‘æ§æ•°æ®æ˜¯æ€§èƒ½ä¼˜åŒ–å’Œæ•…éšœè¯Šæ–­çš„é‡è¦ä¾æ®
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éœ€è¦é‡ç‚¹å…³æ³¨å®‰å…¨é…ç½®