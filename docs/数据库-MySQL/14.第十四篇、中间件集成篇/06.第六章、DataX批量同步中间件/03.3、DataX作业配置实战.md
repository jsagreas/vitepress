---
title: 3ã€DataXä½œä¸šé…ç½®å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [DataXä½œä¸šé…ç½®åŸºç¡€](#1-DataXä½œä¸šé…ç½®åŸºç¡€)
2. [JSONä½œä¸šé…ç½®è¯¦è§£](#2-JSONä½œä¸šé…ç½®è¯¦è§£)
3. [Readeræ’ä»¶é…ç½®å®æˆ˜](#3-Readeræ’ä»¶é…ç½®å®æˆ˜)
4. [Writeræ’ä»¶é…ç½®å®æˆ˜](#4-Writeræ’ä»¶é…ç½®å®æˆ˜)
5. [Transformè½¬æ¢é…ç½®](#5-Transformè½¬æ¢é…ç½®)
6. [å­—æ®µæ˜ å°„ä¸ç±»å‹è½¬æ¢](#6-å­—æ®µæ˜ å°„ä¸ç±»å‹è½¬æ¢)
7. [ä½œä¸šå‚æ•°åŒ–é…ç½®](#7-ä½œä¸šå‚æ•°åŒ–é…ç½®)
8. [é…ç½®æ¨¡æ¿åº“ä¸å·¥å…·](#8-é…ç½®æ¨¡æ¿åº“ä¸å·¥å…·)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ DataXä½œä¸šé…ç½®åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯DataXä½œä¸šé…ç½®


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šDataXä½œä¸šé…ç½®å°±æ˜¯å‘Šè¯‰DataX"ä»å“ªé‡Œè¯»æ•°æ®ã€æ€ä¹ˆå¤„ç†æ•°æ®ã€å†™åˆ°å“ªé‡Œå»"çš„è¯´æ˜ä¹¦ã€‚

```
ç®€å•ç†è§£ï¼š
æ¬å®¶æ—¶éœ€è¦æ¬å®¶æ¸…å• â†’ DataXéœ€è¦ä½œä¸šé…ç½®
æ¸…å•å†™æ˜ï¼šä»å“ªä¸ªæˆ¿é—´ã€æ¬ä»€ä¹ˆä¸œè¥¿ã€æ”¾åˆ°æ–°å®¶å“ªé‡Œ
é…ç½®å†™æ˜ï¼šä»å“ªä¸ªæ•°æ®æºã€è¯»ä»€ä¹ˆæ•°æ®ã€å†™åˆ°å“ªä¸ªç›®æ ‡
```

**é…ç½®æ–‡ä»¶æœ¬è´¨**ï¼š
- **æ ¼å¼**ï¼šJSONæ–‡ä»¶ï¼Œç»“æ„åŒ–æè¿°åŒæ­¥ä»»åŠ¡
- **ä½œç”¨**ï¼šå®šä¹‰æ•°æ®åŒæ­¥çš„å®Œæ•´æµç¨‹
- **ä½ç½®**ï¼šé€šå¸¸ä¿å­˜ä¸º`.json`æ–‡ä»¶ï¼Œé€šè¿‡å‘½ä»¤è¡Œè°ƒç”¨

### 1.2 é…ç½®æ–‡ä»¶åŸºæœ¬ç»“æ„


```
DataXé…ç½®æ–‡ä»¶ = ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Jobé…ç½®       â”‚ â† æ•´ä½“ä»»åŠ¡è®¾ç½®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Contenté…ç½®   â”‚ â† å…·ä½“åŒæ­¥å†…å®¹
â”‚   â”œâ”€Readerâ”€â”€â”€â”€â”€â”€â”‚ â† æ•°æ®æºè¯»å–é…ç½®
â”‚   â”œâ”€Transformâ”€â”€â”‚ â† æ•°æ®è½¬æ¢é…ç½®ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€Writerâ”€â”€â”€â”€â”€â”‚ â† ç›®æ ‡å†™å…¥é…ç½®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Settingé…ç½®   â”‚ â† æ€§èƒ½å‚æ•°è®¾ç½®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æœ€ç®€é…ç½®ç¤ºä¾‹


```json
{
  "job": {
    "content": [
      {
        "reader": {
          "name": "mysqlreader",
          "parameter": {
            "è¿æ¥ä¿¡æ¯": "æ•°æ®åº“è¿æ¥é…ç½®",
            "æŸ¥è¯¢è¯­å¥": "SELECTè¯­å¥"
          }
        },
        "writer": {
          "name": "mysqlwriter", 
          "parameter": {
            "è¿æ¥ä¿¡æ¯": "ç›®æ ‡æ•°æ®åº“é…ç½®",
            "å†™å…¥è¡¨": "ç›®æ ‡è¡¨é…ç½®"
          }
        }
      }
    ],
    "setting": {
      "speed": {
        "channel": 1
      }
    }
  }
}
```

---

## 2. ğŸ“„ JSONä½œä¸šé…ç½®è¯¦è§£


### 2.1 JSONé…ç½®æ–‡ä»¶ç»“æ„è§£æ


**å®Œæ•´é…ç½®ç»“æ„**ï¼š
```json
{
  "job": {
    "content": [
      {
        "reader": { /* è¯»å–ç«¯é…ç½® */ },
        "transformer": [ /* è½¬æ¢é…ç½®ï¼Œå¯é€‰ */ ],
        "writer": { /* å†™å…¥ç«¯é…ç½® */ }
      }
    ],
    "setting": {
      "speed": { /* é€Ÿåº¦æ§åˆ¶ */ },
      "errorLimit": { /* é”™è¯¯æ§åˆ¶ */ }
    }
  }
}
```

### 2.2 Jobå±‚çº§é…ç½®


**Jobé…ç½®è¯´æ˜**ï¼šJobæ˜¯æœ€å¤–å±‚çš„é…ç½®ï¼ŒåŒ…å«æ•´ä¸ªåŒæ­¥ä»»åŠ¡çš„æ‰€æœ‰ä¿¡æ¯ã€‚

```json
{
  "job": {
    "content": [
      // è¿™é‡Œæ˜¯å…·ä½“çš„åŒæ­¥å†…å®¹é…ç½®
      // å¯ä»¥é…ç½®å¤šä¸ªcontentï¼Œå®ç°å¤šè·¯åŒæ­¥
    ],
    "setting": {
      // è¿™é‡Œæ˜¯å…¨å±€è®¾ç½®ï¼Œå½±å“æ•´ä¸ªä»»åŠ¡çš„æ‰§è¡Œ
    }
  }
}
```

**ä¸ºä»€ä¹ˆç”¨æ•°ç»„**ï¼šcontentæ˜¯æ•°ç»„æ ¼å¼ï¼Œæ„å‘³ç€ä¸€ä¸ªDataXä»»åŠ¡å¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªä¸åŒçš„æ•°æ®åŒæ­¥ã€‚

```
å®é™…åº”ç”¨åœºæ™¯ï¼š
ä¸€æ¬¡ä»»åŠ¡åŒæ­¥å¤šå¼ è¡¨ï¼š
content[0]: åŒæ­¥ç”¨æˆ·è¡¨ user_info
content[1]: åŒæ­¥è®¢å•è¡¨ order_info  
content[2]: åŒæ­¥å•†å“è¡¨ product_info
```

### 2.3 Contentå†…å®¹é…ç½®


**Contenté…ç½®æ ¸å¿ƒ**ï¼šæ¯ä¸ªcontentä»£è¡¨ä¸€ä¸ªå…·ä½“çš„æ•°æ®åŒæ­¥é€šé“ã€‚

```json
{
  "reader": {
    "name": "æ’ä»¶åç§°",           // ä½¿ç”¨å“ªä¸ªè¯»å–æ’ä»¶
    "parameter": {               // æ’ä»¶çš„å…·ä½“å‚æ•°
      "connection": [],          // è¿æ¥ä¿¡æ¯
      "table": [],              // è¦è¯»å–çš„è¡¨
      "column": [],             // è¦è¯»å–çš„å­—æ®µ
      "splitPk": "",            // åˆ‡åˆ†ä¸»é”®
      "where": ""               // è¿‡æ»¤æ¡ä»¶
    }
  },
  "writer": {
    "name": "æ’ä»¶åç§°",           // ä½¿ç”¨å“ªä¸ªå†™å…¥æ’ä»¶  
    "parameter": {               // æ’ä»¶çš„å…·ä½“å‚æ•°
      "connection": [],          // ç›®æ ‡è¿æ¥ä¿¡æ¯
      "table": [],              // ç›®æ ‡è¡¨
      "column": [],             // ç›®æ ‡å­—æ®µ
      "writeMode": ""           // å†™å…¥æ¨¡å¼
    }
  }
}
```

---

## 3. ğŸ“– Readeræ’ä»¶é…ç½®å®æˆ˜


### 3.1 MySQL Readeré…ç½®è¯¦è§£


**åŸºæœ¬é…ç½®ç»“æ„**ï¼š
```json
{
  "reader": {
    "name": "mysqlreader",
    "parameter": {
      "connection": [
        {
          "jdbcUrl": ["jdbc:mysql://localhost:3306/test"],
          "table": ["user_info"]
        }
      ],
      "username": "root",
      "password": "123456",
      "column": ["id", "name", "age", "email"],
      "splitPk": "id",
      "where": "age > 18"
    }
  }
}
```

**å…³é”®å‚æ•°è¯´æ˜**ï¼š

| å‚æ•°å | ä½œç”¨ | ç¤ºä¾‹å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `jdbcUrl` | æ•°æ®åº“è¿æ¥åœ°å€ | `jdbc:mysql://localhost:3306/test` | æ”¯æŒå¤šä¸ªURLï¼Œç”¨äºåˆ†åº“åœºæ™¯ |
| `table` | è¦åŒæ­¥çš„è¡¨å | `["user_info", "user_detail"]` | æ”¯æŒå¤šè¡¨åŒæ­¥ |
| `column` | è¦åŒæ­¥çš„å­—æ®µ | `["id", "name", "*"]` | `*`è¡¨ç¤ºæ‰€æœ‰å­—æ®µ |
| `splitPk` | åˆ†ç‰‡ä¸»é”® | `"id"` | ç”¨äºå¹¶è¡Œè¯»å–ï¼Œæå‡æ€§èƒ½ |
| `where` | è¿‡æ»¤æ¡ä»¶ | `"create_time >= '2023-01-01'"` | SQL whereæ¡ä»¶ |

### 3.2 Oracle Readeré…ç½®


```json
{
  "reader": {
    "name": "oraclereader",
    "parameter": {
      "connection": [
        {
          "jdbcUrl": ["jdbc:oracle:thin:@localhost:1521:orcl"],
          "table": ["SCOTT.EMP"]
        }
      ],
      "username": "scott",
      "password": "tiger",
      "column": ["EMPNO", "ENAME", "SAL", "DEPTNO"],
      "splitPk": "EMPNO"
    }
  }
}
```

**Oracleç‰¹æ®Šæ³¨æ„**ï¼š
- è¡¨åé€šå¸¸éœ€è¦åŠ schemaå‰ç¼€ï¼š`SCOTT.EMP`
- å­—æ®µååŒºåˆ†å¤§å°å†™
- æ—¥æœŸæ ¼å¼éœ€è¦ç‰¹åˆ«å¤„ç†

### 3.3 æ–‡ä»¶Readeré…ç½®


**TXTæ–‡ä»¶è¯»å–**ï¼š
```json
{
  "reader": {
    "name": "txtfilereader",
    "parameter": {
      "path": ["/data/export/user_*.txt"],
      "encoding": "UTF-8",
      "column": [
        {"index": 0, "type": "string"},
        {"index": 1, "type": "long"},
        {"index": 2, "type": "string"}
      ],
      "fieldDelimiter": "\t",
      "skipHeader": false
    }
  }
}
```

**æ–‡ä»¶é…ç½®è¯´æ˜**ï¼š
- `path`ï¼šæ”¯æŒé€šé…ç¬¦ï¼Œå¯ä»¥è¯»å–å¤šä¸ªæ–‡ä»¶
- `column`ï¼šæŒ‰ä½ç½®å®šä¹‰å­—æ®µç±»å‹
- `fieldDelimiter`ï¼šå­—æ®µåˆ†éš”ç¬¦
- `skipHeader`ï¼šæ˜¯å¦è·³è¿‡é¦–è¡Œ

---

## 4. âœï¸ Writeræ’ä»¶é…ç½®å®æˆ˜


### 4.1 MySQL Writeré…ç½®è¯¦è§£


**åŸºæœ¬é…ç½®**ï¼š
```json
{
  "writer": {
    "name": "mysqlwriter",
    "parameter": {
      "connection": [
        {
          "jdbcUrl": "jdbc:mysql://target:3306/warehouse",
          "table": ["dim_user"]
        }
      ],
      "username": "etl_user",
      "password": "etl_pass",
      "column": ["user_id", "user_name", "user_age", "user_email"],
      "writeMode": "replace",
      "preSql": ["truncate table dim_user"],
      "postSql": ["call update_user_stats()"]
    }
  }
}
```

**å†™å…¥æ¨¡å¼è¯´æ˜**ï¼š

| writeMode | è¡Œä¸ºæè¿° | é€‚ç”¨åœºæ™¯ |
|-----------|----------|----------|
| `insert` | ç›´æ¥æ’å…¥ï¼Œé‡åˆ°ä¸»é”®å†²çªæŠ¥é”™ | å…¨æ–°æ•°æ®å¯¼å…¥ |
| `replace` | æ›¿æ¢æ¨¡å¼ï¼Œåˆ é™¤åæ’å…¥ | éœ€è¦å®Œå…¨æ›¿æ¢æ•°æ® |
| `update` | æ›´æ–°æ¨¡å¼ï¼Œåªæ›´æ–°å·²å­˜åœ¨è®°å½• | å¢é‡æ›´æ–°åœºæ™¯ |

### 4.2 HDFS Writeré…ç½®


```json
{
  "writer": {
    "name": "hdfswriter",
    "parameter": {
      "defaultFS": "hdfs://namenode:9000",
      "path": "/user/hive/warehouse/user_info",
      "fileName": "user_data",
      "fileType": "text",
      "writeMode": "append",
      "fieldDelimiter": "\001",
      "encoding": "UTF-8",
      "column": [
        {"name": "user_id", "type": "bigint"},
        {"name": "user_name", "type": "string"},
        {"name": "create_time", "type": "string"}
      ]
    }
  }
}
```

### 4.3 Elasticsearch Writeré…ç½®


```json
{
  "writer": {
    "name": "elasticsearchwriter",
    "parameter": {
      "endpoint": "http://es-cluster:9200",
      "accessId": "elastic",
      "accessKey": "password",
      "index": "user_index",
      "type": "_doc",
      "cleanup": true,
      "column": [
        {"name": "id", "type": "long"},
        {"name": "name", "type": "text"},
        {"name": "age", "type": "integer"}
      ]
    }
  }
}
```

---

## 5. ğŸ”„ Transformè½¬æ¢é…ç½®


### 5.1 Transformè½¬æ¢ä»‹ç»


**ä»€ä¹ˆæ˜¯Transform**ï¼šTransformæ˜¯DataXçš„æ•°æ®è½¬æ¢åŠŸèƒ½ï¼Œåœ¨æ•°æ®ä»Readerè¯»å‡ºåˆ°Writerå†™å…¥ä¹‹é—´ï¼Œå¯¹æ•°æ®è¿›è¡ŒåŠ å·¥å¤„ç†ã€‚

```
æ•°æ®æµå‘ï¼š
æºæ•°æ® â†’ Readerè¯»å– â†’ Transformè½¬æ¢ â†’ Writerå†™å…¥ â†’ ç›®æ ‡æ•°æ®

è½¬æ¢æ“ä½œåŒ…æ‹¬ï¼š
- å­—æ®µé‡å‘½å
- æ•°æ®ç±»å‹è½¬æ¢  
- å­—æ®µå€¼è®¡ç®—
- æ¡ä»¶è¿‡æ»¤
- æ ¼å¼æ ‡å‡†åŒ–
```

### 5.2 åŸºæœ¬Transformé…ç½®


```json
{
  "transformer": [
    {
      "name": "dx_groovy",
      "parameter": {
        "code": "return record.setColumn(columnIndex, newValue);",
        "extraPackage": []
      }
    }
  ]
}
```

### 5.3 å¸¸ç”¨Transformç¤ºä¾‹


**å­—æ®µå€¼è½¬æ¢**ï¼š
```json
{
  "transformer": [
    {
      "name": "dx_groovy",
      "parameter": {
        "code": "
          // å°†æ€§åˆ«æ•°å­—è½¬æ¢ä¸ºæ–‡å­—
          if (record.getColumn(2).asString().equals('1')) {
            record.setColumn(2, 'ç”·');
          } else if (record.getColumn(2).asString().equals('2')) {
            record.setColumn(2, 'å¥³');
          }
          return record;
        "
      }
    }
  ]
}
```

**æ—¥æœŸæ ¼å¼è½¬æ¢**ï¼š
```json
{
  "transformer": [
    {
      "name": "dx_groovy", 
      "parameter": {
        "code": "
          import java.text.SimpleDateFormat;
          String dateStr = record.getColumn(3).asString();
          SimpleDateFormat input = new SimpleDateFormat('yyyy/MM/dd');
          SimpleDateFormat output = new SimpleDateFormat('yyyy-MM-dd');
          Date date = input.parse(dateStr);
          record.setColumn(3, output.format(date));
          return record;
        "
      }
    }
  ]
}
```

---

## 6. ğŸ—‚ï¸ å­—æ®µæ˜ å°„ä¸ç±»å‹è½¬æ¢


### 6.1 å­—æ®µæ˜ å°„è§„åˆ™é…ç½®


**åŸºæœ¬æ˜ å°„æ¦‚å¿µ**ï¼šå­—æ®µæ˜ å°„å°±æ˜¯å‘Šè¯‰DataXæºè¡¨çš„å­—æ®µå’Œç›®æ ‡è¡¨çš„å­—æ®µå¦‚ä½•å¯¹åº”ã€‚

```
æºè¡¨å­—æ®µ â†’ ç›®æ ‡è¡¨å­—æ®µ
user_id  â†’ id
user_name â†’ name  
user_age â†’ age
create_date â†’ created_at
```

**ç²¾ç¡®æ˜ å°„é…ç½®**ï¼š
```json
{
  "reader": {
    "parameter": {
      "column": ["user_id", "user_name", "user_age", "create_date"]
    }
  },
  "writer": {
    "parameter": {
      "column": ["id", "name", "age", "created_at"]
    }
  }
}
```

### 6.2 æ•°æ®ç±»å‹è½¬æ¢é…ç½®


**ç±»å‹è½¬æ¢æ˜ å°„è¡¨**ï¼š

| MySQLç±»å‹ | DataXç±»å‹ | ç›®æ ‡ç±»å‹ | è½¬æ¢è¯´æ˜ |
|-----------|-----------|----------|----------|
| `INT` | `Long` | `BIGINT` | æ•´æ•°æ‰©å±• |
| `VARCHAR` | `String` | `TEXT` | å­—ç¬¦ä¸²ç±»å‹ |
| `DECIMAL` | `Double` | `DECIMAL` | ç²¾åº¦ä¿æŒ |
| `DATETIME` | `Date` | `TIMESTAMP` | æ—¶é—´æˆ³æ ¼å¼ |

**ç±»å‹è½¬æ¢ç¤ºä¾‹**ï¼š
```json
{
  "reader": {
    "parameter": {
      "column": [
        "cast(user_id as char) as user_id_str",
        "cast(amount as decimal(10,2)) as amount_decimal",
        "date_format(create_time, '%Y-%m-%d %H:%i:%s') as create_time_str"
      ]
    }
  }
}
```

### 6.3 å¤æ‚æ˜ å°„è§„åˆ™é…ç½®


**æ¡ä»¶æ˜ å°„**ï¼š
```json
{
  "reader": {
    "parameter": {
      "column": [
        "user_id",
        "user_name", 
        "case when age < 18 then 'æœªæˆå¹´' when age >= 60 then 'è€å¹´' else 'æˆå¹´' end as age_group",
        "concat(first_name, ' ', last_name) as full_name"
      ]
    }
  }
}
```

**NULLå€¼å¤„ç†**ï¼š
```json
{
  "reader": {
    "parameter": {
      "column": [
        "coalesce(phone, 'æœªæä¾›') as phone",
        "ifnull(email, 'no-email@example.com') as email"
      ]
    }
  }
}
```

---

## 7. âš™ï¸ ä½œä¸šå‚æ•°åŒ–é…ç½®


### 7.1 ä»€ä¹ˆæ˜¯å‚æ•°åŒ–é…ç½®


**å‚æ•°åŒ–çš„å¥½å¤„**ï¼šä¸€å¥—é…ç½®æ¨¡æ¿ï¼Œé€šè¿‡ä¼ å…¥ä¸åŒå‚æ•°ï¼Œå°±èƒ½å¤„ç†ä¸åŒçš„åŒæ­¥ä»»åŠ¡ã€‚

```
ä¸ä½¿ç”¨å‚æ•°åŒ–ï¼š
- åŒæ­¥userè¡¨éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶
- åŒæ­¥orderè¡¨éœ€è¦å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶  
- åŒæ­¥productè¡¨éœ€è¦ç¬¬ä¸‰ä¸ªé…ç½®æ–‡ä»¶

ä½¿ç”¨å‚æ•°åŒ–ï¼š
- ä¸€ä¸ªé…ç½®æ¨¡æ¿
- ä¼ å…¥ä¸åŒçš„è¡¨åå‚æ•°
- ä¸€å¥—é…ç½®å¤„ç†æ‰€æœ‰è¡¨
```

### 7.2 å‚æ•°åŒ–è¯­æ³•


**åŸºæœ¬è¯­æ³•**ï¼šä½¿ç”¨`${å‚æ•°å}`çš„å½¢å¼åœ¨é…ç½®ä¸­å®šä¹‰å‚æ•°å ä½ç¬¦ã€‚

```json
{
  "job": {
    "content": [
      {
        "reader": {
          "name": "mysqlreader",
          "parameter": {
            "connection": [
              {
                "jdbcUrl": ["${sourceUrl}"],
                "table": ["${sourceTable}"]
              }
            ],
            "username": "${sourceUser}",
            "password": "${sourcePassword}",
            "column": ${sourceColumns},
            "where": "${filterCondition}"
          }
        },
        "writer": {
          "name": "mysqlwriter",
          "parameter": {
            "connection": [
              {
                "jdbcUrl": "${targetUrl}",
                "table": ["${targetTable}"]
              }
            ],
            "username": "${targetUser}",
            "password": "${targetPassword}",
            "column": ${targetColumns}
          }
        }
      }
    ]
  }
}
```

### 7.3 å‚æ•°ä¼ é€’æ–¹å¼


**å‘½ä»¤è¡Œä¼ å‚**ï¼š
```bash
python datax.py job_template.json \
  -p sourceUrl="jdbc:mysql://source:3306/db1" \
  -p sourceTable="user_info" \
  -p targetTable="dim_user" \
  -p filterCondition="status = 'active'"
```

**å‚æ•°æ–‡ä»¶ä¼ å‚**ï¼š
```bash
# åˆ›å»ºå‚æ•°æ–‡ä»¶ params.properties
sourceUrl=jdbc:mysql://source:3306/db1
sourceTable=user_info
targetTable=dim_user
sourceColumns=["id","name","age"]
targetColumns=["user_id","user_name","user_age"]

# ä½¿ç”¨å‚æ•°æ–‡ä»¶
python datax.py job_template.json -p params.properties
```

### 7.4 åŠ¨æ€æ—¥æœŸå‚æ•°


**å¸¸ç”¨æ—¥æœŸå‚æ•°**ï¼š
```json
{
  "reader": {
    "parameter": {
      "where": "create_time >= '${yesterday}' and create_time < '${today}'"
    }
  }
}
```

**æ—¥æœŸå‚æ•°è„šæœ¬**ï¼š
```bash
#!/bin/bash
TODAY=$(date +%Y-%m-%d)
YESTERDAY=$(date -d "1 day ago" +%Y-%m-%d)

python datax.py sync_daily.json \
  -p today="$TODAY" \
  -p yesterday="$YESTERDAY"
```

---

## 8. ğŸ“š é…ç½®æ¨¡æ¿åº“ä¸å·¥å…·


### 8.1 DataXä½œä¸šé…ç½®æ¨¡æ¿åº“


**MySQLåŒæ­¥æ¨¡æ¿**ï¼š
```json
{
  "job": {
    "content": [
      {
        "reader": {
          "name": "mysqlreader",
          "parameter": {
            "connection": [{"jdbcUrl": ["${source.url}"], "table": ["${source.table}"]}],
            "username": "${source.username}",
            "password": "${source.password}",
            "column": ${source.columns},
            "splitPk": "${source.splitPk}"
          }
        },
        "writer": {
          "name": "mysqlwriter",
          "parameter": {
            "connection": [{"jdbcUrl": "${target.url}", "table": ["${target.table}"]}],
            "username": "${target.username}",
            "password": "${target.password}",
            "column": ${target.columns},
            "writeMode": "${target.writeMode}"
          }
        }
      }
    ],
    "setting": {
      "speed": {"channel": ${job.channel}},
      "errorLimit": {"record": ${job.errorLimit}}
    }
  }
}
```

**å¢é‡åŒæ­¥æ¨¡æ¿**ï¼š
```json
{
  "job": {
    "content": [
      {
        "reader": {
          "name": "mysqlreader", 
          "parameter": {
            "connection": [{"jdbcUrl": ["${source.url}"], "table": ["${source.table}"]}],
            "username": "${source.username}",
            "password": "${source.password}",
            "column": ${source.columns},
            "where": "${source.incrementColumn} > '${lastSyncTime}'"
          }
        }
      }
    ]
  }
}
```

### 8.2 åŠ¨æ€é…ç½®ç”Ÿæˆå·¥å…·


**Pythoné…ç½®ç”Ÿæˆè„šæœ¬**ï¼š
```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import json
import sys

def generate_datax_config(source_config, target_config):
    """ç”ŸæˆDataXé…ç½®æ–‡ä»¶"""
    
    template = {
        "job": {
            "content": [
                {
                    "reader": {
                        "name": "mysqlreader",
                        "parameter": {
                            "connection": [
                                {
                                    "jdbcUrl": [source_config["url"]],
                                    "table": [source_config["table"]]
                                }
                            ],
                            "username": source_config["username"],
                            "password": source_config["password"],
                            "column": source_config["columns"]
                        }
                    },
                    "writer": {
                        "name": "mysqlwriter",
                        "parameter": {
                            "connection": [
                                {
                                    "jdbcUrl": target_config["url"],
                                    "table": [target_config["table"]]
                                }
                            ],
                            "username": target_config["username"],
                            "password": target_config["password"],
                            "column": target_config["columns"]
                        }
                    }
                }
            ],
            "setting": {
                "speed": {"channel": 3}
            }
        }
    }
    
    return json.dumps(template, indent=2, ensure_ascii=False)

# ä½¿ç”¨ç¤ºä¾‹
source = {
    "url": "jdbc:mysql://localhost:3306/source_db",
    "table": "user_info",
    "username": "root",
    "password": "123456",
    "columns": ["id", "name", "age"]
}

target = {
    "url": "jdbc:mysql://target:3306/warehouse",
    "table": "dim_user", 
    "username": "etl_user",
    "password": "etl_pass",
    "columns": ["user_id", "user_name", "user_age"]
}

config = generate_datax_config(source, target)
print(config)
```

### 8.3 é…ç½®æ ¡éªŒä¸ä¼˜åŒ–


**é…ç½®æ ¡éªŒè„šæœ¬**ï¼š
```python
def validate_datax_config(config_file):
    """æ ¡éªŒDataXé…ç½®æ–‡ä»¶"""
    
    with open(config_file, 'r') as f:
        config = json.load(f)
    
    # æ£€æŸ¥å¿…éœ€å­—æ®µ
    required_fields = ['job', 'job.content', 'job.content[0].reader', 'job.content[0].writer']
    
    for field in required_fields:
        if not check_field_exists(config, field):
            return False, f"ç¼ºå°‘å¿…éœ€å­—æ®µ: {field}"
    
    # æ£€æŸ¥è¿æ¥é…ç½®
    reader = config['job']['content'][0]['reader']
    if 'connection' not in reader['parameter']:
        return False, "Readerç¼ºå°‘connectioné…ç½®"
        
    # æ£€æŸ¥å­—æ®µæ˜ å°„
    reader_columns = reader['parameter'].get('column', [])
    writer_columns = config['job']['content'][0]['writer']['parameter'].get('column', [])
    
    if len(reader_columns) != len(writer_columns):
        return False, "Readerå’ŒWriterçš„å­—æ®µæ•°é‡ä¸åŒ¹é…"
    
    return True, "é…ç½®æ ¡éªŒé€šè¿‡"

# æ€§èƒ½ä¼˜åŒ–å»ºè®®
def optimize_config(config):
    """é…ç½®ä¼˜åŒ–å»ºè®®"""
    suggestions = []
    
    # æ£€æŸ¥æ˜¯å¦é…ç½®äº†splitPk
    reader = config['job']['content'][0]['reader']
    if 'splitPk' not in reader['parameter']:
        suggestions.append("å»ºè®®é…ç½®splitPkä»¥æå‡å¹¶è¡Œè¯»å–æ€§èƒ½")
    
    # æ£€æŸ¥channelæ•°é‡
    channels = config['job']['setting'].get('speed', {}).get('channel', 1)
    if channels == 1:
        suggestions.append("å»ºè®®å¢åŠ channelæ•°é‡ä»¥æå‡åŒæ­¥é€Ÿåº¦")
    
    return suggestions
```

### 8.4 æ‰¹é‡é…ç½®ç®¡ç†


**æ‰¹é‡ç”Ÿæˆé…ç½®**ï¼š
```bash
#!/bin/bash

# è¡¨ååˆ—è¡¨
TABLES=("user_info" "order_info" "product_info" "category_info")

# å¾ªç¯ç”Ÿæˆé…ç½®
for table in "${TABLES[@]}"; do
    cat > "${table}_sync.json" << EOF
{
  "job": {
    "content": [
      {
        "reader": {
          "name": "mysqlreader",
          "parameter": {
            "connection": [{"jdbcUrl": ["jdbc:mysql://source:3306/db"], "table": ["${table}"]}],
            "username": "root",
            "password": "123456",
            "column": ["*"]
          }
        },
        "writer": {
          "name": "mysqlwriter", 
          "parameter": {
            "connection": [{"jdbcUrl": "jdbc:mysql://target:3306/warehouse", "table": ["${table}"]}],
            "username": "etl_user",
            "password": "etl_pass",
            "column": ["*"],
            "writeMode": "replace"
          }
        }
      }
    ],
    "setting": {
      "speed": {"channel": 3}
    }
  }
}
EOF
    echo "ç”Ÿæˆé…ç½®æ–‡ä»¶: ${table}_sync.json"
done
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é…ç½®æ–‡ä»¶ç»“æ„ï¼šJob â†’ Content â†’ Reader/Writer â†’ Parameter
ğŸ”¸ æ’ä»¶é…ç½®ï¼šæ¯ç§æ•°æ®æºæœ‰å¯¹åº”çš„Reader/Writeræ’ä»¶
ğŸ”¸ å­—æ®µæ˜ å°„ï¼šæºå­—æ®µå’Œç›®æ ‡å­—æ®µçš„å¯¹åº”å…³ç³»
ğŸ”¸ å‚æ•°åŒ–ï¼šä½¿ç”¨${å‚æ•°å}å®ç°é…ç½®å¤ç”¨
ğŸ”¸ ç±»å‹è½¬æ¢ï¼šä¸åŒæ•°æ®æºé—´çš„æ•°æ®ç±»å‹é€‚é…
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é…ç½®æ–‡ä»¶å°±æ˜¯ä»»åŠ¡è¯´æ˜ä¹¦**ï¼š
```
æ ¸å¿ƒä½œç”¨ï¼š
- å‘Šè¯‰DataXä»å“ªé‡Œè¯»æ•°æ®ï¼ˆReaderé…ç½®ï¼‰
- å‘Šè¯‰DataXå¦‚ä½•å¤„ç†æ•°æ®ï¼ˆTransformé…ç½®ï¼‰  
- å‘Šè¯‰DataXå†™åˆ°å“ªé‡Œå»ï¼ˆWriteré…ç½®ï¼‰
- å‘Šè¯‰DataXç”¨ä»€ä¹ˆæ€§èƒ½å‚æ•°ï¼ˆSettingé…ç½®ï¼‰
```

**ğŸ”¹ å‚æ•°åŒ–æ˜¯é…ç½®å¤ç”¨çš„å…³é”®**ï¼š
```
å®é™…ä»·å€¼ï¼š
- ä¸€å¥—æ¨¡æ¿é…ç½®å¤šä¸ªç›¸ä¼¼ä»»åŠ¡
- é€šè¿‡å‚æ•°æ§åˆ¶åŒæ­¥èŒƒå›´å’Œæ¡ä»¶
- ä¾¿äºè‡ªåŠ¨åŒ–è°ƒåº¦å’Œæ‰¹é‡æ‰§è¡Œ
- é™ä½é…ç½®ç»´æŠ¤æˆæœ¬
```

**ğŸ”¹ å­—æ®µæ˜ å°„å†³å®šæ•°æ®è½¬æ¢æ•ˆæœ**ï¼š
```
é‡è¦æ€§ï¼š
- ç¡®å®šæºæ•°æ®å’Œç›®æ ‡æ•°æ®çš„å¯¹åº”å…³ç³»
- æ§åˆ¶æ•°æ®ç±»å‹è½¬æ¢è§„åˆ™
- å®ç°å­—æ®µé‡å‘½åå’Œæ ¼å¼æ ‡å‡†åŒ–
- æ”¯æŒå¤æ‚çš„æ•°æ®è®¡ç®—å’Œè½¬æ¢
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ“Š å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
- **æ•°æ®ä»“åº“ETL**ï¼šä»ä¸šåŠ¡åº“åŒæ­¥æ•°æ®åˆ°æ•°æ®ä»“åº“
- **æ•°æ®åº“è¿ç§»**ï¼šä»æ—§ç³»ç»Ÿè¿ç§»æ•°æ®åˆ°æ–°ç³»ç»Ÿ
- **å¼‚æ„æ•°æ®åŒæ­¥**ï¼šä¸åŒç±»å‹æ•°æ®åº“é—´çš„æ•°æ®åŒæ­¥
- **å¤‡ä»½ä¸å½’æ¡£**ï¼šå®šæœŸå°†æ•°æ®å¤‡ä»½åˆ°æ–‡ä»¶æˆ–å…¶ä»–å­˜å‚¨

**ğŸ”§ å®é™…é…ç½®æŠ€å·§**ï¼š
- **åˆ†æ‰¹åŒæ­¥**ï¼šå¤§è¡¨ä½¿ç”¨splitPkåˆ†ç‰‡æå‡æ€§èƒ½
- **å¢é‡åŒæ­¥**ï¼šä½¿ç”¨æ—¶é—´æˆ³å­—æ®µå®ç°å¢é‡æ›´æ–°
- **é”™è¯¯å¤„ç†**ï¼šåˆç†è®¾ç½®errorLimité¿å…ä»»åŠ¡ä¸­æ–­
- **æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®æ•°æ®é‡å’Œç½‘ç»œæƒ…å†µè°ƒæ•´channelæ•°

**æ ¸å¿ƒè®°å¿†**ï¼š
- DataXé…ç½®å°±æ˜¯æ•°æ®æ¬è¿çš„è·¯çº¿å›¾
- JSONæ ¼å¼æè¿°å®Œæ•´çš„åŒæ­¥æµç¨‹
- å‚æ•°åŒ–å®ç°é…ç½®æ¨¡æ¿å¤ç”¨
- Readerè¯»å–Writerå†™å…¥Transformè½¬æ¢