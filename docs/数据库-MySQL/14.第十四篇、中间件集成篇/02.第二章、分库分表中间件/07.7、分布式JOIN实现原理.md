---
title: 7ã€åˆ†å¸ƒå¼JOINå®ç°åŸç†
---
## ğŸ“š ç›®å½•

1. [åˆ†å¸ƒå¼JOINåŸºç¡€æ¦‚å¿µ](#1-åˆ†å¸ƒå¼JOINåŸºç¡€æ¦‚å¿µ)
2. [è·¨åˆ†ç‰‡JOINç®—æ³•è¯¦è§£](#2-è·¨åˆ†ç‰‡JOINç®—æ³•è¯¦è§£)
3. [åµŒå¥—å¾ªç¯JOINå®ç°](#3-åµŒå¥—å¾ªç¯JOINå®ç°)
4. [Hash JOINåˆ†å¸ƒå¼å®ç°](#4-Hash-JOINåˆ†å¸ƒå¼å®ç°)
5. [æ’åºåˆå¹¶JOINä¼˜åŒ–](#5-æ’åºåˆå¹¶JOINä¼˜åŒ–)
6. [JOINç»“æœé›†åˆå¹¶ç­–ç•¥](#6-JOINç»“æœé›†åˆå¹¶ç­–ç•¥)
7. [JOINæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯](#7-JOINæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯)
8. [JOINæŸ¥è¯¢é‡å†™æŠ€æœ¯](#8-JOINæŸ¥è¯¢é‡å†™æŠ€æœ¯)
9. [åˆ†å¸ƒå¼JOINæ‰§è¡Œè®¡åˆ’](#9-åˆ†å¸ƒå¼JOINæ‰§è¡Œè®¡åˆ’)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ åˆ†å¸ƒå¼JOINåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼JOIN


**ç®€å•ç†è§£**ï¼šåˆ†å¸ƒå¼JOINå°±æ˜¯æŠŠå­˜å‚¨åœ¨ä¸åŒæ•°æ®åº“èŠ‚ç‚¹ä¸Šçš„è¡¨è¿›è¡Œè¿æ¥æŸ¥è¯¢

```
ä¼ ç»Ÿå•æœºJOINï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¡¨   â”‚ â†â†’ â”‚ è®¢å•è¡¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    åŒä¸€ä¸ªæ•°æ®åº“ä¸­

åˆ†å¸ƒå¼JOINï¼š
èŠ‚ç‚¹A: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    èŠ‚ç‚¹B: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ ç”¨æˆ·è¡¨   â”‚         â”‚ è®¢å•è¡¨   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         é€šè¿‡ç½‘ç»œè¿æ¥æŸ¥è¯¢
```

### 1.2 åˆ†å¸ƒå¼JOINçš„æŒ‘æˆ˜


**ğŸ’¡ ä¸»è¦éš¾ç‚¹**
- **æ•°æ®åˆ†æ•£**ï¼šç›¸å…³æ•°æ®åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸Š
- **ç½‘ç»œå»¶è¿Ÿ**ï¼šè·¨èŠ‚ç‚¹æŸ¥è¯¢å¢åŠ å“åº”æ—¶é—´
- **å†…å­˜é™åˆ¶**ï¼šå•èŠ‚ç‚¹æ— æ³•å­˜å‚¨æ‰€æœ‰æ•°æ®
- **æ‰§è¡Œå¤æ‚**ï¼šéœ€è¦åè°ƒå¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œ

**ğŸ”¸ ä¸å•æœºJOINçš„åŒºåˆ«**
```
å•æœºJOINï¼š
- æ•°æ®åœ¨åŒä¸€ä¸ªå†…å­˜ç©ºé—´
- ç›´æ¥è®¿é—®æ‰€æœ‰è¡¨
- ç®—æ³•ç®€å•ç›´æ¥

åˆ†å¸ƒå¼JOINï¼š
- æ•°æ®éœ€è¦ç½‘ç»œä¼ è¾“
- éœ€è¦åˆ†é˜¶æ®µæ‰§è¡Œ
- éœ€è¦ç»“æœåˆå¹¶
```

### 1.3 åˆ†å¸ƒå¼JOINçš„åˆ†ç±»


**æŒ‰æ•°æ®åˆ†å¸ƒåˆ†ç±»**ï¼š

ğŸ”¹ **åŒèŠ‚ç‚¹JOIN**
```sql
-- ç”¨æˆ·è¡¨å’Œç”¨æˆ·è¯¦æƒ…è¡¨éƒ½åœ¨èŠ‚ç‚¹A
SELECT u.name, ud.phone 
FROM user u 
JOIN user_detail ud ON u.id = ud.user_id
```

ğŸ”¹ **è·¨èŠ‚ç‚¹JOIN**
```sql
-- ç”¨æˆ·è¡¨åœ¨èŠ‚ç‚¹Aï¼Œè®¢å•è¡¨åœ¨èŠ‚ç‚¹B
SELECT u.name, o.amount 
FROM user u 
JOIN order o ON u.id = o.user_id
```

**æŒ‰JOINç±»å‹åˆ†ç±»**ï¼š
- **ç­‰å€¼JOIN**ï¼š`ON u.id = o.user_id`
- **éç­‰å€¼JOIN**ï¼š`ON u.age > o.min_age`
- **å¤–è¿æ¥**ï¼š`LEFT JOIN`, `RIGHT JOIN`, `FULL JOIN`

---

## 2. âš™ï¸ è·¨åˆ†ç‰‡JOINç®—æ³•è¯¦è§£


### 2.1 ç®—æ³•åˆ†ç±»æ¦‚è¿°


**ğŸ¯ ä¸‰å¤§æ ¸å¿ƒç®—æ³•**

```
ç®—æ³•ç±»å‹            é€‚ç”¨åœºæ™¯              æ€§èƒ½ç‰¹ç‚¹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚åµŒå¥—å¾ªç¯JOIN   â”‚   â”‚å°è¡¨ Ã— å¤§è¡¨    â”‚     â”‚å®ç°ç®€å•       â”‚
â”‚(Nested Loop) â”‚   â”‚ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿ   â”‚     â”‚ç½‘ç»œå¼€é”€å¤§     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Hash JOIN     â”‚   â”‚å¤§è¡¨ Ã— å¤§è¡¨    â”‚     â”‚å†…å­˜è¦æ±‚é«˜     â”‚
â”‚              â”‚   â”‚ç­‰å€¼è¿æ¥       â”‚     â”‚æ€§èƒ½è¾ƒå¥½       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æ’åºåˆå¹¶JOIN   â”‚   â”‚æœ‰åºæ•°æ®       â”‚     â”‚ç¨³å®šæ€§å¥½       â”‚
â”‚(Sort Merge)  â”‚   â”‚å¤§æ•°æ®é‡       â”‚     â”‚æ’åºå¼€é”€       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç®—æ³•é€‰æ‹©ç­–ç•¥


**ğŸ” é€‰æ‹©åŸåˆ™**

> **ğŸ’¡ æ ¸å¿ƒåŸåˆ™**ï¼šæ ¹æ®è¡¨å¤§å°ã€ç½‘ç»œæƒ…å†µã€å†…å­˜èµ„æºé€‰æ‹©æœ€ä¼˜ç®—æ³•
> 
> - å°è¡¨é©±åŠ¨å¤§è¡¨ï¼šä¼˜å…ˆé€‰æ‹©åµŒå¥—å¾ªç¯
> - ç­‰å€¼è¿æ¥å¤§è¡¨ï¼šä¼˜å…ˆé€‰æ‹©Hash JOIN
> - æ•°æ®å·²æ’åºï¼šä¼˜å…ˆé€‰æ‹©æ’åºåˆå¹¶

**âš–ï¸ ç®—æ³•æ¯”è¾ƒè¡¨**

| ç®—æ³•ç±»å‹ | **å†…å­˜éœ€æ±‚** | **ç½‘ç»œå¼€é”€** | **æ—¶é—´å¤æ‚åº¦** | **é€‚ç”¨æ•°æ®é‡** |
|---------|-------------|-------------|---------------|---------------|
| åµŒå¥—å¾ªç¯ | `ä½` | `é«˜` | `O(MÃ—N)` | `å°è¡¨Ã—å¤§è¡¨` |
| Hash JOIN | `é«˜` | `ä¸­` | `O(M+N)` | `å¤§è¡¨Ã—å¤§è¡¨` |
| æ’åºåˆå¹¶ | `ä¸­` | `ä¸­` | `O(M log M + N log N)` | `è¶…å¤§è¡¨` |

### 2.3 æ•°æ®ä¼ è¾“ä¼˜åŒ–


**ğŸ“¡ æ•°æ®ä¼ è¾“ç­–ç•¥**

```
ç­–ç•¥1ï¼šå¹¿æ’­å°è¡¨
å°è¡¨Aå¹¿æ’­åˆ°æ‰€æœ‰èŠ‚ç‚¹ â†’ å„èŠ‚ç‚¹æœ¬åœ°JOIN

èŠ‚ç‚¹1: [å°è¡¨A] + [å¤§è¡¨Båˆ†ç‰‡1] â†’ JOINç»“æœ1
èŠ‚ç‚¹2: [å°è¡¨A] + [å¤§è¡¨Båˆ†ç‰‡2] â†’ JOINç»“æœ2
èŠ‚ç‚¹3: [å°è¡¨A] + [å¤§è¡¨Båˆ†ç‰‡3] â†’ JOINç»“æœ3

ç­–ç•¥2ï¼šé‡åˆ†å¸ƒå¤§è¡¨
æŒ‰JOINé”®é‡æ–°åˆ†å¸ƒå¤§è¡¨ â†’ åŒé”®æ•°æ®åœ¨åŒä¸€èŠ‚ç‚¹

é‡åˆ†å¸ƒå‰: ç”¨æˆ·1,3,5åœ¨èŠ‚ç‚¹A  è®¢å•1,2,4åœ¨èŠ‚ç‚¹B
é‡åˆ†å¸ƒå: ç”¨æˆ·1,è®¢å•1åœ¨èŠ‚ç‚¹A  ç”¨æˆ·3,è®¢å•3åœ¨èŠ‚ç‚¹B
```

---

## 3. ğŸ”„ åµŒå¥—å¾ªç¯JOINå®ç°


### 3.1 åŸºæœ¬å®ç°åŸç†


**ğŸ¯ å·¥ä½œæœºåˆ¶**ï¼šå¤–è¡¨çš„æ¯ä¸€è¡Œéƒ½è¦ä¸å†…è¡¨çš„æ‰€æœ‰è¡Œè¿›è¡Œæ¯”è¾ƒ

```
åŸºæœ¬æµç¨‹ï¼š
å¤–è¡¨ï¼ˆé©±åŠ¨è¡¨ï¼‰  å†…è¡¨ï¼ˆè¢«é©±åŠ¨è¡¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”
â”‚  A1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ B1 â”‚ æ¯”è¾ƒ
â”‚  A2 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ B2 â”‚ æ¯”è¾ƒ
â”‚  A3 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ B3 â”‚ æ¯”è¾ƒ
â””â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”˜

ä¼ªä»£ç ï¼š
for each row in å¤–è¡¨:
    for each row in å†…è¡¨:
        if æ»¡è¶³JOINæ¡ä»¶:
            è¾“å‡ºç»“æœè¡Œ
```

### 3.2 åˆ†å¸ƒå¼åµŒå¥—å¾ªç¯å®ç°


**ğŸ“‹ å®ç°æ­¥éª¤**

**æ­¥éª¤1ï¼šé€‰æ‹©é©±åŠ¨è¡¨**
```java
// é€‰æ‹©è¾ƒå°çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨
if (tableA.getRowCount() < tableB.getRowCount()) {
    outerTable = tableA;  // å°è¡¨åšå¤–è¡¨
    innerTable = tableB;  // å¤§è¡¨åšå†…è¡¨
}
```

**æ­¥éª¤2ï¼šæ•°æ®åˆ†å‘ç­–ç•¥**
```
ç­–ç•¥Aï¼šå¹¿æ’­é©±åŠ¨è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åè°ƒèŠ‚ç‚¹   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   å¹¿æ’­å°è¡¨A
       â†“
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚èŠ‚ç‚¹1 â”‚  â”‚èŠ‚ç‚¹2 â”‚  â”‚èŠ‚ç‚¹3 â”‚
â”‚A+B1 â”‚  â”‚A+B2 â”‚  â”‚A+B3 â”‚
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
```

**æ­¥éª¤3ï¼šæœ¬åœ°JOINæ‰§è¡Œ**
```java
// åœ¨æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œæœ¬åœ°JOIN
public class LocalNestedLoopJoin {
    public List<Row> execute(Table outerTable, Table innerTable) {
        List<Row> results = new ArrayList<>();
        
        for (Row outerRow : outerTable.getRows()) {
            for (Row innerRow : innerTable.getRows()) {
                if (joinCondition(outerRow, innerRow)) {
                    Row joinedRow = mergeRows(outerRow, innerRow);
                    results.add(joinedRow);
                }
            }
        }
        return results;
    }
}
```

### 3.3 ä¼˜åŒ–æŠ€æœ¯


**ğŸš€ å—åµŒå¥—å¾ªç¯ä¼˜åŒ–**

```
æ™®é€šåµŒå¥—å¾ªç¯ï¼šé€è¡Œæ¯”è¾ƒ
å—åµŒå¥—å¾ªç¯ï¼šæ‰¹é‡å¤„ç†

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¤–è¡¨æ•°æ®å—     â”‚ â† ä¸€æ¬¡è¯»å–å¤šè¡Œ
â”‚   A1, A2, A3    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ ä¸å†…è¡¨æ¯ä¸ªå—æ¯”è¾ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å†…è¡¨æ•°æ®å—     â”‚
â”‚   B1, B2, B3    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¾ ç¼“å­˜ä¼˜åŒ–**
```java
// å†…è¡¨æ•°æ®ç¼“å­˜
public class CachedNestedLoopJoin {
    private Map<Object, List<Row>> innerTableIndex;
    
    // é¢„å…ˆå»ºç«‹å†…è¡¨ç´¢å¼•
    public void buildIndex(Table innerTable, String joinColumn) {
        innerTableIndex = innerTable.getRows()
            .stream()
            .collect(Collectors.groupingBy(
                row -> row.getValue(joinColumn)
            ));
    }
    
    // å¿«é€ŸæŸ¥æ‰¾åŒ¹é…è¡Œ
    public List<Row> findMatches(Object joinValue) {
        return innerTableIndex.getOrDefault(joinValue, Collections.emptyList());
    }
}
```

---

## 4. ğŸ“Š Hash JOINåˆ†å¸ƒå¼å®ç°


### 4.1 Hash JOINåŸºæœ¬åŸç†


**ğŸ¯ æ ¸å¿ƒæ€æƒ³**ï¼šå°†ä¸€ä¸ªè¡¨æ„å»ºæˆHashè¡¨ï¼Œå¦ä¸€ä¸ªè¡¨é€è¡Œæ¢æµ‹

```
æ„å»ºé˜¶æ®µï¼ˆBuild Phaseï¼‰ï¼š
å°è¡¨A â†’ Hashè¡¨
â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A1  â”‚â”€â”€â”€â†’â”‚Hash Bucket 1â”‚
â”‚ A2  â”‚â”€â”€â”€â†’â”‚Hash Bucket 2â”‚
â”‚ A3  â”‚â”€â”€â”€â†’â”‚Hash Bucket 1â”‚
â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¢æµ‹é˜¶æ®µï¼ˆProbe Phaseï¼‰ï¼š
å¤§è¡¨B â†’ æ¢æµ‹Hashè¡¨
â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B1  â”‚â”€â”€â”€â†’â”‚æŸ¥æ‰¾åŒ¹é…     â”‚ â†’ è¾“å‡ºç»“æœ
â”‚ B2  â”‚â”€â”€â”€â†’â”‚æŸ¥æ‰¾åŒ¹é…     â”‚ â†’ è¾“å‡ºç»“æœ
â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åˆ†å¸ƒå¼Hash JOINå®ç°


**ğŸ—ï¸ å®ç°æ¶æ„**

```
é˜¶æ®µ1ï¼šHashè¡¨æ„å»º
åè°ƒèŠ‚ç‚¹                    æ‰§è¡ŒèŠ‚ç‚¹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚é€‰æ‹©æ„å»ºè¡¨â”‚ â”€â”€â”€å¹¿æ’­â”€â”€â”€â”€â†’  â”‚æ„å»ºHashè¡¨â”‚
â”‚(è¾ƒå°è¡¨) â”‚               â”‚å­˜å‚¨åœ¨å†…å­˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2ï¼šæ•°æ®æ¢æµ‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚åˆ†å‘æ¢æµ‹è¡¨â”‚ â”€â”€â”€åˆ†ç‰‡â”€â”€â”€â”€â†’  â”‚é€è¡Œæ¢æµ‹  â”‚
â”‚(è¾ƒå¤§è¡¨) â”‚               â”‚è¾“å‡ºç»“æœ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“ ä»£ç å®ç°**

```java
public class DistributedHashJoin {
    private Map<Object, List<Row>> hashTable;
    
    // é˜¶æ®µ1ï¼šæ„å»ºHashè¡¨
    public void buildPhase(Table buildTable, String joinColumn) {
        hashTable = new HashMap<>();
        
        for (Row row : buildTable.getRows()) {
            Object key = row.getValue(joinColumn);
            hashTable.computeIfAbsent(key, k -> new ArrayList<>()).add(row);
        }
        
        System.out.println("Hashè¡¨æ„å»ºå®Œæˆï¼ŒåŒ…å« " + hashTable.size() + " ä¸ªæ¡¶");
    }
    
    // é˜¶æ®µ2ï¼šæ¢æµ‹é˜¶æ®µ
    public List<Row> probePhase(Table probeTable, String joinColumn) {
        List<Row> results = new ArrayList<>();
        
        for (Row probeRow : probeTable.getRows()) {
            Object key = probeRow.getValue(joinColumn);
            List<Row> matches = hashTable.get(key);
            
            if (matches != null) {
                for (Row buildRow : matches) {
                    Row joinedRow = mergeRows(probeRow, buildRow);
                    results.add(joinedRow);
                }
            }
        }
        return results;
    }
}
```

### 4.3 Hashåˆ†åŒºç­–ç•¥


**ğŸ”€ åˆ†åŒºç®—æ³•**

```java
public class HashPartitioner {
    private int partitionCount;
    
    // ä¸€è‡´æ€§Hashåˆ†åŒº
    public int getPartition(Object key) {
        return Math.abs(key.hashCode()) % partitionCount;
    }
    
    // èŒƒå›´Hashåˆ†åŒº
    public int getRangePartition(Object key, int[] ranges) {
        int hash = Math.abs(key.hashCode());
        for (int i = 0; i < ranges.length; i++) {
            if (hash <= ranges[i]) {
                return i;
            }
        }
        return ranges.length - 1;
    }
}
```

**âš¡ åˆ†åŒºä¼˜åŒ–**

> **ğŸ”§ ä¼˜åŒ–æŠ€å·§**ï¼š
> - **åŠ¨æ€åˆ†åŒºè°ƒæ•´**ï¼šæ ¹æ®æ•°æ®å€¾æ–œæƒ…å†µè°ƒæ•´åˆ†åŒº
> - **æœ¬åœ°ä¼˜åŒ–**ï¼šç›¸åŒåˆ†åŒºçš„æ•°æ®ä¼˜å…ˆæœ¬åœ°å¤„ç†
> - **å†…å­˜ç®¡ç†**ï¼šå¤§Hashè¡¨åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º

---

## 5. ğŸ”€ æ’åºåˆå¹¶JOINä¼˜åŒ–


### 5.1 æ’åºåˆå¹¶JOINåŸç†


**ğŸ¯ åŸºæœ¬æ€æƒ³**ï¼šå°†ä¸¤ä¸ªè¡¨æŒ‰JOINé”®æ’åºï¼Œç„¶ååƒåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ä¸€æ ·è¿›è¡ŒJOIN

```
æ’åºåçš„è¡¨A:        æ’åºåçš„è¡¨B:
â”Œâ”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”
â”‚  1  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  1  â”‚ åŒ¹é…
â”‚  3  â”‚            â”‚  2  â”‚
â”‚  5  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  5  â”‚ åŒ¹é…
â”‚  7  â”‚            â”‚  6  â”‚
â””â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”˜
  æŒ‡é’ˆA              æŒ‡é’ˆB
```

### 5.2 åˆ†å¸ƒå¼æ’åºåˆå¹¶å®ç°


**ğŸ“‹ å®ç°æµç¨‹**

**é˜¶æ®µ1ï¼šæœ¬åœ°æ’åº**
```java
public class DistributedSortMergeJoin {
    
    // æœ¬åœ°æ’åºé˜¶æ®µ
    public Table localSort(Table table, String sortColumn) {
        List<Row> sortedRows = table.getRows()
            .stream()
            .sorted((r1, r2) -> 
                compareValues(r1.getValue(sortColumn), r2.getValue(sortColumn))
            )
            .collect(Collectors.toList());
            
        return new Table(sortedRows);
    }
}
```

**é˜¶æ®µ2ï¼šå…¨å±€æ’åº**
```
æœ¬åœ°æ’åºç»“æœåˆå¹¶ï¼š
èŠ‚ç‚¹1: [1,3,5]    èŠ‚ç‚¹2: [2,4,6]    èŠ‚ç‚¹3: [7,8,9]
              â†“
         å…¨å±€æœ‰åº: [1,2,3,4,5,6,7,8,9]
```

**é˜¶æ®µ3ï¼šåˆå¹¶JOIN**
```java
public List<Row> mergeJoin(Table leftTable, Table rightTable, String joinColumn) {
    List<Row> results = new ArrayList<>();
    Iterator<Row> leftIter = leftTable.iterator();
    Iterator<Row> rightIter = rightTable.iterator();
    
    Row leftRow = leftIter.hasNext() ? leftIter.next() : null;
    Row rightRow = rightIter.hasNext() ? rightIter.next() : null;
    
    while (leftRow != null && rightRow != null) {
        Object leftValue = leftRow.getValue(joinColumn);
        Object rightValue = rightRow.getValue(joinColumn);
        
        int comparison = compareValues(leftValue, rightValue);
        
        if (comparison == 0) {
            // ç›¸ç­‰ï¼Œæ‰§è¡ŒJOIN
            results.add(mergeRows(leftRow, rightRow));
            leftRow = leftIter.hasNext() ? leftIter.next() : null;
        } else if (comparison < 0) {
            // å·¦è¾¹å°ï¼Œç§»åŠ¨å·¦æŒ‡é’ˆ
            leftRow = leftIter.hasNext() ? leftIter.next() : null;
        } else {
            // å³è¾¹å°ï¼Œç§»åŠ¨å³æŒ‡é’ˆ
            rightRow = rightIter.hasNext() ? rightIter.next() : null;
        }
    }
    
    return results;
}
```

### 5.3 æ’åºä¼˜åŒ–ç­–ç•¥


**ğŸš€ å¤–éƒ¨æ’åº**

```
å¤§æ•°æ®é‡æ’åºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹æ•°æ®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   åˆ†å—æ’åº
       â†“
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚å—1  â”‚ â”‚å—2  â”‚ â”‚å—3  â”‚
â”‚å·²æ’åºâ”‚ â”‚å·²æ’åºâ”‚ â”‚å·²æ’åºâ”‚
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
       â”‚
   å¤šè·¯å½’å¹¶
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨å±€æœ‰åº   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¾ å†…å­˜ä¼˜åŒ–**
```java
public class ExternalSort {
    private int memoryLimit;
    private String tempDir;
    
    public void sortLargeTable(Table table, String sortColumn) {
        // 1. åˆ†å—æ’åº
        List<File> sortedChunks = new ArrayList<>();
        int chunkSize = memoryLimit / estimateRowSize();
        
        for (int i = 0; i < table.getRowCount(); i += chunkSize) {
            List<Row> chunk = table.getRows(i, Math.min(i + chunkSize, table.getRowCount()));
            Collections.sort(chunk, (r1, r2) -> 
                compareValues(r1.getValue(sortColumn), r2.getValue(sortColumn)));
            
            File chunkFile = writeToTempFile(chunk);
            sortedChunks.add(chunkFile);
        }
        
        // 2. å¤šè·¯å½’å¹¶
        mergeSortedChunks(sortedChunks);
    }
}
```

---

## 6. ğŸ”— JOINç»“æœé›†åˆå¹¶ç­–ç•¥


### 6.1 ç»“æœé›†åˆå¹¶æŒ‘æˆ˜


**ğŸ¤” ä¸»è¦é—®é¢˜**
- **æ•°æ®é‡å¤**ï¼šå¤šä¸ªèŠ‚ç‚¹å¯èƒ½äº§ç”Ÿç›¸åŒç»“æœ
- **æ’åºæ··ä¹±**ï¼šåˆå¹¶åå¯èƒ½å¤±å»åŸæœ‰é¡ºåº
- **å†…å­˜å‹åŠ›**ï¼šå¤§é‡ç»“æœé›†å ç”¨å†…å­˜
- **ç½‘ç»œä¼ è¾“**ï¼šè·¨èŠ‚ç‚¹ä¼ è¾“ç»“æœå¼€é”€å¤§

### 6.2 åˆå¹¶ç®—æ³•è®¾è®¡


**ğŸ“Š åˆ†é˜¶æ®µåˆå¹¶**

```
èŠ‚ç‚¹1ç»“æœ â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
èŠ‚ç‚¹2ç»“æœ â†’ â”‚ä¸­é—´åˆå¹¶ â”‚ â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
èŠ‚ç‚¹3ç»“æœ â†’ â”‚  èŠ‚ç‚¹   â”‚   â”‚æœ€ç»ˆåˆå¹¶ â”‚ â†’ æœ€ç»ˆç»“æœ
èŠ‚ç‚¹4ç»“æœ â†’ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  èŠ‚ç‚¹   â”‚
...                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼šå‡å°‘ç½‘ç»œä¼ è¾“ï¼Œåˆ†æ•£åˆå¹¶å‹åŠ›
ç¼ºç‚¹ï¼šå¢åŠ ä¸­é—´ç¯èŠ‚ï¼Œå¯èƒ½å¢åŠ å»¶è¿Ÿ
```

**ğŸ”„ æµå¼åˆå¹¶**
```java
public class StreamMerger {
    private List<Iterator<Row>> resultIterators;
    private PriorityQueue<RowWithSource> mergeQueue;
    
    public Iterator<Row> mergeResults(List<Iterator<Row>> iterators, String sortColumn) {
        this.resultIterators = iterators;
        this.mergeQueue = new PriorityQueue<>((r1, r2) -> 
            compareValues(r1.getRow().getValue(sortColumn), 
                         r2.getRow().getValue(sortColumn)));
        
        // åˆå§‹åŒ–é˜Ÿåˆ—
        for (int i = 0; i < iterators.size(); i++) {
            if (iterators.get(i).hasNext()) {
                mergeQueue.offer(new RowWithSource(iterators.get(i).next(), i));
            }
        }
        
        return new Iterator<Row>() {
            @Override
            public boolean hasNext() {
                return !mergeQueue.isEmpty();
            }
            
            @Override
            public Row next() {
                RowWithSource current = mergeQueue.poll();
                
                // ä»åŒä¸€æ•°æ®æºç»§ç»­è¯»å–
                if (resultIterators.get(current.getSource()).hasNext()) {
                    Row nextRow = resultIterators.get(current.getSource()).next();
                    mergeQueue.offer(new RowWithSource(nextRow, current.getSource()));
                }
                
                return current.getRow();
            }
        };
    }
}
```

### 6.3 å»é‡ç­–ç•¥


**ğŸ¯ å»é‡ç®—æ³•**

```java
public class ResultDeduplicator {
    
    // åŸºäºHashçš„å»é‡
    public List<Row> deduplicateByHash(List<Row> results, List<String> keyColumns) {
        Set<String> seen = new HashSet<>();
        List<Row> deduplicated = new ArrayList<>();
        
        for (Row row : results) {
            String key = buildKey(row, keyColumns);
            if (seen.add(key)) {  // å¦‚æœæ˜¯æ–°çš„keyï¼Œaddè¿”å›true
                deduplicated.add(row);
            }
        }
        
        return deduplicated;
    }
    
    // åŸºäºæ’åºçš„å»é‡
    public List<Row> deduplicateBySorting(List<Row> results, List<String> keyColumns) {
        results.sort((r1, r2) -> compareRows(r1, r2, keyColumns));
        
        List<Row> deduplicated = new ArrayList<>();
        Row previous = null;
        
        for (Row current : results) {
            if (previous == null || !equalRows(previous, current, keyColumns)) {
                deduplicated.add(current);
                previous = current;
            }
        }
        
        return deduplicated;
    }
}
```

---

## 7. âš¡ JOINæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯


### 7.1 æ•°æ®å€¾æ–œå¤„ç†


**ğŸ¯ å€¾æ–œæ£€æµ‹**

```java
public class DataSkewDetector {
    
    public Map<Object, Integer> analyzeDistribution(Table table, String column) {
        Map<Object, Integer> distribution = new HashMap<>();
        
        for (Row row : table.getRows()) {
            Object value = row.getValue(column);
            distribution.merge(value, 1, Integer::sum);
        }
        
        return distribution;
    }
    
    public boolean isSkewed(Map<Object, Integer> distribution, double threshold) {
        if (distribution.isEmpty()) return false;
        
        int totalRows = distribution.values().stream().mapToInt(Integer::intValue).sum();
        int maxCount = distribution.values().stream().mapToInt(Integer::intValue).max().orElse(0);
        
        double skewRatio = (double) maxCount / totalRows;
        return skewRatio > threshold;  // ä¾‹å¦‚ï¼šè¶…è¿‡50%è®¤ä¸ºå€¾æ–œ
    }
}
```

**ğŸ”§ å€¾æ–œä¼˜åŒ–ç­–ç•¥**

> **ğŸ’¡ åŠ ç›æŠ€æœ¯**ï¼šä¸ºå€¾æ–œçš„keyæ·»åŠ éšæœºåç¼€ï¼Œåˆ†æ•£åˆ°å¤šä¸ªåˆ†åŒº
> 
> ```
> åŸå§‹æ•°æ®ï¼š
> key="hot_key" â†’ åˆ†åŒº1 (90%æ•°æ®)
> key="normal"  â†’ åˆ†åŒº2 (10%æ•°æ®)
> 
> åŠ ç›åï¼š
> key="hot_key_1" â†’ åˆ†åŒº1 (30%æ•°æ®)
> key="hot_key_2" â†’ åˆ†åŒº2 (30%æ•°æ®) 
> key="hot_key_3" â†’ åˆ†åŒº3 (30%æ•°æ®)
> ```

### 7.2 é¢„å¤„ç†ä¼˜åŒ–


**ğŸ“Š ç»Ÿè®¡ä¿¡æ¯æ”¶é›†**
```java
public class JoinStatistics {
    private long tableSize;
    private Map<String, ColumnStats> columnStats;
    
    public static class ColumnStats {
        private long distinctCount;    // å”¯ä¸€å€¼æ•°é‡
        private Object minValue;       // æœ€å°å€¼
        private Object maxValue;       // æœ€å¤§å€¼
        private double nullRatio;      // ç©ºå€¼æ¯”ä¾‹
        
        // åŸºæ•°ä¼°ç®—
        public double getSelectivity() {
            return 1.0 / distinctCount;
        }
    }
    
    // æˆæœ¬ä¼°ç®—
    public double estimateJoinCost(JoinStatistics other, String joinType) {
        double selectivity = this.getColumnStats("join_key").getSelectivity();
        return this.tableSize * other.tableSize * selectivity;
    }
}
```

**ğŸ¯ æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–**
```java
public class JoinPlanOptimizer {
    
    public JoinPlan optimize(List<Table> tables, List<JoinCondition> conditions) {
        // 1. è¡¨æ’åºï¼šå°è¡¨ä¼˜å…ˆ
        tables.sort((t1, t2) -> Long.compare(t1.getRowCount(), t2.getRowCount()));
        
        // 2. JOINé¡ºåºä¼˜åŒ–
        JoinPlan plan = new JoinPlan();
        for (int i = 1; i < tables.size(); i++) {
            JoinCondition condition = findBestCondition(tables.get(i-1), tables.get(i), conditions);
            plan.addJoin(tables.get(i-1), tables.get(i), condition);
        }
        
        return plan;
    }
}
```

### 7.3 ç¼“å­˜å’Œé¢„è®¡ç®—


**ğŸ’¾ ä¸­é—´ç»“æœç¼“å­˜**
```java
public class JoinCache {
    private Map<String, CachedResult> cache;
    private long maxCacheSize;
    
    public static class CachedResult {
        private List<Row> result;
        private long timestamp;
        private long accessCount;
    }
    
    // ç¼“å­˜JOINç»“æœ
    public void cacheResult(String cacheKey, List<Row> result) {
        if (cache.size() >= maxCacheSize) {
            evictLeastUsed();
        }
        
        cache.put(cacheKey, new CachedResult(result, System.currentTimeMillis(), 0));
    }
    
    // è·å–ç¼“å­˜ç»“æœ
    public List<Row> getCachedResult(String cacheKey) {
        CachedResult cached = cache.get(cacheKey);
        if (cached != null) {
            cached.accessCount++;
            return cached.result;
        }
        return null;
    }
}
```

---

## 8. ğŸ”„ JOINæŸ¥è¯¢é‡å†™æŠ€æœ¯


### 8.1 æŸ¥è¯¢é‡å†™åŸºç¡€


**ğŸ¯ é‡å†™ç›®æ ‡**ï¼šå°†å¤æ‚çš„è·¨åˆ†ç‰‡JOINè½¬æ¢ä¸ºæ›´é«˜æ•ˆçš„æ‰§è¡Œè®¡åˆ’

```sql
-- åŸå§‹æŸ¥è¯¢
SELECT u.name, o.amount, p.product_name
FROM user u
JOIN order o ON u.id = o.user_id
JOIN product p ON o.product_id = p.id
WHERE u.city = 'Beijing'

-- é‡å†™åçš„æŸ¥è¯¢è®¡åˆ’
1. å…ˆè¿‡æ»¤ï¼šSELECT * FROM user WHERE city = 'Beijing'
2. å†JOINï¼šfiltered_user JOIN order ON user_id
3. æœ€åJOINï¼šresult JOIN product ON product_id
```

### 8.2 è°“è¯ä¸‹æ¨ä¼˜åŒ–


**ğŸ“‹ ä¸‹æ¨è§„åˆ™**

```java
public class PredicatePushdown {
    
    public Query pushdownPredicates(Query originalQuery) {
        Query optimizedQuery = originalQuery.copy();
        
        // 1. æå–WHEREæ¡ä»¶
        List<Predicate> predicates = extractPredicates(originalQuery.getWhereClause());
        
        // 2. åˆ†æè°“è¯ä¾èµ–
        for (Predicate predicate : predicates) {
            Set<String> referencedTables = predicate.getReferencedTables();
            
            // 3. å•è¡¨è°“è¯ä¸‹æ¨åˆ°è¡¨æ‰«æ
            if (referencedTables.size() == 1) {
                String tableName = referencedTables.iterator().next();
                optimizedQuery.pushPredicateToTable(tableName, predicate);
            }
        }
        
        return optimizedQuery;
    }
}
```

**ğŸ’¡ ä¸‹æ¨ç¤ºä¾‹**
```
åŸå§‹SQLï¼š
SELECT u.name, o.amount 
FROM user u 
JOIN order o ON u.id = o.user_id 
WHERE u.age > 25 AND o.status = 'completed'

é‡å†™åï¼š
1. æ‰«æuserè¡¨æ—¶ï¼šSELECT * FROM user WHERE age > 25
2. æ‰«æorderè¡¨æ—¶ï¼šSELECT * FROM order WHERE status = 'completed'  
3. å†æ‰§è¡ŒJOINï¼šfiltered_user JOIN filtered_order
```

### 8.3 å­æŸ¥è¯¢é‡å†™


**ğŸ”€ EXISTSé‡å†™ä¸ºJOIN**

```sql
-- åŸå§‹å­æŸ¥è¯¢
SELECT u.name 
FROM user u 
WHERE EXISTS (
    SELECT 1 FROM order o 
    WHERE o.user_id = u.id AND o.amount > 1000
)

-- é‡å†™ä¸ºJOIN
SELECT DISTINCT u.name 
FROM user u 
JOIN order o ON u.id = o.user_id 
WHERE o.amount > 1000
```

**ğŸ“Š INå­æŸ¥è¯¢é‡å†™**
```java
public class SubqueryRewriter {
    
    public Query rewriteInSubquery(Query query) {
        // è¯†åˆ«INå­æŸ¥è¯¢
        if (query.hasInSubquery()) {
            InSubquery inClause = query.getInSubquery();
            
            // è½¬æ¢ä¸ºJOIN
            JoinClause joinClause = new JoinClause();
            joinClause.setJoinType(JoinType.INNER);
            joinClause.setLeftTable(query.getFromTable());
            joinClause.setRightTable(inClause.getSubquery().getFromTable());
            joinClause.setCondition(createJoinCondition(inClause));
            
            // é‡æ„æŸ¥è¯¢
            Query rewritten = new Query();
            rewritten.setFrom(joinClause);
            rewritten.setSelect(query.getSelectClause());
            
            return rewritten;
        }
        
        return query;
    }
}
```

---

## 9. ğŸ“ˆ åˆ†å¸ƒå¼JOINæ‰§è¡Œè®¡åˆ’


### 9.1 æ‰§è¡Œè®¡åˆ’ç”Ÿæˆ


**ğŸ—ï¸ è®¡åˆ’æ ‘ç»“æ„**

```
æ‰§è¡Œè®¡åˆ’æ ‘ï¼š
                    ProjectionNode
                         â”‚
                    HashJoinNode
                    /          \
            TableScanNode   TableScanNode
            (userè¡¨)        (orderè¡¨)
                â”‚               â”‚
            FilterNode      FilterNode
            (age > 25)     (status='completed')
```

### 9.2 æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–


**âš¡ ä»£ä»·æ¨¡å‹**

```java
public class CostModel {
    
    public double calculateJoinCost(JoinNode joinNode) {
        double leftSize = joinNode.getLeftChild().getEstimatedSize();
        double rightSize = joinNode.getRightChild().getEstimatedSize();
        double selectivity = joinNode.getSelectivity();
        
        // ä¸åŒJOINç®—æ³•çš„ä»£ä»·è®¡ç®—
        switch (joinNode.getJoinType()) {
            case NESTED_LOOP:
                return leftSize * rightSize * NESTED_LOOP_COST_FACTOR;
                
            case HASH_JOIN:
                return (leftSize + rightSize) * HASH_JOIN_COST_FACTOR + 
                       Math.min(leftSize, rightSize) * HASH_BUILD_COST;
                       
            case SORT_MERGE:
                return leftSize * Math.log(leftSize) + rightSize * Math.log(rightSize) +
                       (leftSize + rightSize) * MERGE_COST_FACTOR;
                       
            default:
                return Double.MAX_VALUE;
        }
    }
}
```

**ğŸ¯ æ‰§è¡Œå™¨å®ç°**

```java
public class DistributedJoinExecutor {
    
    public ResultSet execute(JoinPlan plan) {
        List<Future<List<Row>>> futures = new ArrayList<>();
        
        // 1. å¹¶è¡Œæ‰§è¡Œå„ä¸ªèŠ‚ç‚¹çš„ä»»åŠ¡
        for (JoinTask task : plan.getTasks()) {
            Future<List<Row>> future = executorService.submit(() -> {
                return executeJoinTask(task);
            });
            futures.add(future);
        }
        
        // 2. æ”¶é›†ç»“æœ
        List<List<Row>> results = new ArrayList<>();
        for (Future<List<Row>> future : futures) {
            try {
                results.add(future.get());
            } catch (Exception e) {
                handleExecutionError(e);
            }
        }
        
        // 3. åˆå¹¶ç»“æœ
        return mergeResults(results);
    }
    
    private List<Row> executeJoinTask(JoinTask task) {
        // æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©æ‰§è¡Œå™¨
        switch (task.getJoinAlgorithm()) {
            case NESTED_LOOP:
                return new NestedLoopJoinExecutor().execute(task);
            case HASH_JOIN:
                return new HashJoinExecutor().execute(task);
            case SORT_MERGE:
                return new SortMergeJoinExecutor().execute(task);
            default:
                throw new UnsupportedOperationException("ä¸æ”¯æŒçš„JOINç®—æ³•");
        }
    }
}
```

### 9.3 ç›‘æ§å’Œè°ƒä¼˜


**ğŸ“Š æ€§èƒ½ç›‘æ§**

```java
public class JoinPerformanceMonitor {
    
    public void recordJoinMetrics(JoinExecution execution) {
        JoinMetrics metrics = new JoinMetrics();
        metrics.setExecutionTime(execution.getExecutionTime());
        metrics.setDataTransferSize(execution.getDataTransferSize());
        metrics.setResultSize(execution.getResultSize());
        metrics.setNetworkLatency(execution.getNetworkLatency());
        
        // è®°å½•åˆ°ç›‘æ§ç³»ç»Ÿ
        metricsCollector.record(metrics);
        
        // æ€§èƒ½åˆ†æ
        if (metrics.getExecutionTime() > SLOW_QUERY_THRESHOLD) {
            analyzeSlowJoin(execution);
        }
    }
    
    private void analyzeSlowJoin(JoinExecution execution) {
        // åˆ†æç“¶é¢ˆ
        if (execution.getNetworkLatency() > NETWORK_THRESHOLD) {
            logger.warn("JOINæŸ¥è¯¢ç½‘ç»œå»¶è¿Ÿè¿‡é«˜ï¼š{}", execution.getNetworkLatency());
        }
        
        if (execution.getDataTransferSize() > DATA_TRANSFER_THRESHOLD) {
            logger.warn("JOINæŸ¥è¯¢æ•°æ®ä¼ è¾“é‡è¿‡å¤§ï¼š{}", execution.getDataTransferSize());
        }
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åˆ†å¸ƒå¼JOINæœ¬è´¨ï¼šè·¨èŠ‚ç‚¹çš„è¡¨è¿æ¥æ“ä½œï¼Œéœ€è¦ç½‘ç»œåè°ƒ
ğŸ”¸ ä¸‰å¤§ç®—æ³•ï¼šåµŒå¥—å¾ªç¯ã€Hash JOINã€æ’åºåˆå¹¶å„æœ‰é€‚ç”¨åœºæ™¯
ğŸ”¸ æ•°æ®ä¼ è¾“ç­–ç•¥ï¼šå¹¿æ’­å°è¡¨ vs é‡åˆ†å¸ƒå¤§è¡¨çš„æƒè¡¡é€‰æ‹©
ğŸ”¸ ç»“æœåˆå¹¶ï¼šå»é‡ã€æ’åºã€åˆ†é˜¶æ®µåˆå¹¶ä¿è¯æ­£ç¡®æ€§
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šç»Ÿè®¡ä¿¡æ¯ã€æ‰§è¡Œè®¡åˆ’ã€ç¼“å­˜æœºåˆ¶æå‡æ•ˆç‡
ğŸ”¸ æŸ¥è¯¢é‡å†™ï¼šè°“è¯ä¸‹æ¨ã€å­æŸ¥è¯¢é‡å†™é™ä½è®¡ç®—å¤æ‚åº¦
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç®—æ³•é€‰æ‹©çš„æ ¸å¿ƒåŸåˆ™**
```
æ•°æ®é‡è€ƒè™‘ï¼š
- å°è¡¨ Ã— å¤§è¡¨ â†’ åµŒå¥—å¾ªç¯ + å¹¿æ’­å°è¡¨
- å¤§è¡¨ Ã— å¤§è¡¨ â†’ Hash JOIN + é‡åˆ†å¸ƒ
- è¶…å¤§è¡¨ Ã— è¶…å¤§è¡¨ â†’ æ’åºåˆå¹¶ + åˆ†å—å¤„ç†

ç½‘ç»œç¯å¢ƒè€ƒè™‘ï¼š
- é«˜å»¶è¿Ÿç½‘ç»œ â†’ å‡å°‘ç½‘ç»œäº¤äº’æ¬¡æ•°
- ä½å¸¦å®½ç½‘ç»œ â†’ å‡å°‘æ•°æ®ä¼ è¾“é‡
- ä¸ç¨³å®šç½‘ç»œ â†’ å¢åŠ å®¹é”™æœºåˆ¶
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç‚¹**
```
æ•°æ®åˆ†å¸ƒä¼˜åŒ–ï¼š
- é¿å…æ•°æ®å€¾æ–œï¼Œä½¿ç”¨åŠ ç›æŠ€æœ¯
- åˆç†é€‰æ‹©åˆ†ç‰‡é”®ï¼Œå‡å°‘è·¨åˆ†ç‰‡JOIN
- é¢„è®¡ç®—å¸¸ç”¨JOINç»“æœ

æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–ï¼š
- å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Œå‡å°‘å¾ªç¯æ¬¡æ•°
- è°“è¯ä¸‹æ¨ï¼Œæå‰è¿‡æ»¤æ•°æ®
- å¹¶è¡Œæ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æº
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç”µå•†ç³»ç»Ÿ**ï¼šç”¨æˆ·è®¢å•å•†å“çš„ä¸‰è¡¨JOINæŸ¥è¯¢
- **é‡‘èç³»ç»Ÿ**ï¼šè´¦æˆ·äº¤æ˜“æµæ°´çš„å…³è”åˆ†æ
- **ç¤¾äº¤ç½‘ç»œ**ï¼šç”¨æˆ·å…³ç³»å¥½å‹åŠ¨æ€çš„å¤åˆæŸ¥è¯¢
- **ç‰©è”ç½‘**ï¼šè®¾å¤‡æ•°æ®äº‹ä»¶çš„æ—¶åºå…³è”

**ğŸ› ï¸ æŠ€æœ¯å®è·µè¦ç‚¹**
- **åˆ†ç‰‡è®¾è®¡**ï¼šæ ¹æ®JOINé¢‘ç‡è®¾è®¡åˆ†ç‰‡ç­–ç•¥
- **ç¼“å­˜ç­–ç•¥**ï¼šç¼“å­˜çƒ­ç‚¹æ•°æ®å’Œå¸¸ç”¨JOINç»“æœ  
- **ç›‘æ§é¢„è­¦**ï¼šç›‘æ§JOINæ€§èƒ½ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- **æ‰©å®¹è§„åˆ’**ï¼šæ ¹æ®æ•°æ®å¢é•¿é¢„ä¼°èµ„æºéœ€æ±‚

**ğŸ¯ æ ¸å¿ƒè®°å¿†**ï¼š
- åˆ†å¸ƒå¼JOINæ ¸å¿ƒæ˜¯æ•°æ®ä¼ è¾“å’Œç®—æ³•é€‰æ‹©çš„å¹³è¡¡
- å°è¡¨å¹¿æ’­å¤§è¡¨åˆ†ç‰‡ï¼ŒHashæ„å»ºé€è¡Œæ¢æµ‹
- æ€§èƒ½ä¼˜åŒ–é‡åœ¨å‡å°‘ç½‘ç»œå¼€é”€å’Œåˆç†åˆ©ç”¨èµ„æº
- æ‰§è¡Œè®¡åˆ’å’ŒæŸ¥è¯¢é‡å†™æ˜¯æå‡æ•ˆç‡çš„å…³é”®æŠ€æœ¯