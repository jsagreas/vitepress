---
title: 13ã€Canaläº‹ä»¶å¤„ç†æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [Canaläº‹ä»¶å¤„ç†æœºåˆ¶æ¦‚è¿°](#1-canaläº‹ä»¶å¤„ç†æœºåˆ¶æ¦‚è¿°)
2. [binlogäº‹ä»¶ç±»å‹è§£æ](#2-binlogäº‹ä»¶ç±»å‹è§£æ)
3. [äº‹ä»¶è¿‡æ»¤ç®—æ³•](#3-äº‹ä»¶è¿‡æ»¤ç®—æ³•)
4. [äº‹ä»¶è½¬æ¢å¤„ç†](#4-äº‹ä»¶è½¬æ¢å¤„ç†)
5. [äº‹ä»¶åºåˆ—åŒ–æœºåˆ¶](#5-äº‹ä»¶åºåˆ—åŒ–æœºåˆ¶)
6. [äº‹ä»¶å­˜å‚¨ä¼˜åŒ–](#6-äº‹ä»¶å­˜å‚¨ä¼˜åŒ–)
7. [äº‹ä»¶å¤„ç†æµæ°´çº¿](#7-äº‹ä»¶å¤„ç†æµæ°´çº¿)
8. [è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨](#8-è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Canaläº‹ä»¶å¤„ç†æœºåˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Canaläº‹ä»¶å¤„ç†æœºåˆ¶

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
Canaläº‹ä»¶å¤„ç†æœºåˆ¶å°±æ˜¯Canalä¸­é—´ä»¶å¦‚ä½•æ¥æ”¶ã€è§£æã€å¤„ç†å’Œåˆ†å‘MySQL binlogäº‹ä»¶çš„æ•´å¥—æµç¨‹ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯**æŠŠMySQLçš„æ•°æ®å˜åŒ–äº‹ä»¶ä¼ é€’ç»™ä¸‹æ¸¸ç³»ç»Ÿçš„æ¡¥æ¢**ã€‚

```
MySQLæ•°æ®å˜åŒ– â†’ binlogè®°å½• â†’ Canalè§£æ â†’ äº‹ä»¶åˆ†å‘ â†’ ä¸‹æ¸¸æ¶ˆè´¹
     â†“              â†“           â†“          â†“         â†“
  INSERT/UPDATE   äºŒè¿›åˆ¶æ—¥å¿—    ç»“æ„åŒ–äº‹ä»¶   æ¶ˆæ¯é˜Ÿåˆ—   ä¸šåŠ¡å¤„ç†
```

**ğŸ“ é€šä¿—ç†è§£**
æƒ³è±¡Canalæ˜¯ä¸€ä¸ªç¿»è¯‘å®˜ï¼š
- **MySQLè¯´çš„è¯**ï¼šäºŒè¿›åˆ¶çš„binlogï¼ˆæœºå™¨è¯­è¨€ï¼‰
- **Canalçš„å·¥ä½œ**ï¼šæŠŠæœºå™¨è¯­è¨€ç¿»è¯‘æˆäººèƒ½æ‡‚çš„äº‹ä»¶ï¼ˆæ¯”å¦‚"ç”¨æˆ·å¼ ä¸‰çš„å¹´é¾„ä»25æ”¹æˆ26"ï¼‰
- **ä¸‹æ¸¸ç³»ç»Ÿ**ï¼šæ ¹æ®è¿™äº›äº‹ä»¶åšç›¸åº”çš„ä¸šåŠ¡å¤„ç†

### 1.2 äº‹ä»¶å¤„ç†çš„æ ¸å¿ƒä»·å€¼


**ğŸ”¥ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**
```
æ•°æ®åŒæ­¥éš¾é¢˜ï¼š
âŒ ä¼ ç»Ÿæ–¹æ¡ˆï¼šå®šæ—¶å…¨é‡åŒæ­¥ â†’ å»¶è¿Ÿé«˜ã€èµ„æºæµªè´¹
âœ… Canalæ–¹æ¡ˆï¼šå®æ—¶å¢é‡åŒæ­¥ â†’ ä½å»¶è¿Ÿã€é«˜æ•ˆç‡

ç³»ç»Ÿè§£è€¦éš¾é¢˜ï¼š
âŒ ç›´æ¥è°ƒç”¨ï¼šç³»ç»Ÿé—´å¼ºè€¦åˆ â†’ ç»´æŠ¤å›°éš¾
âœ… äº‹ä»¶é©±åŠ¨ï¼šé€šè¿‡äº‹ä»¶è§£è€¦ â†’ çµæ´»æ‰©å±•
```

**â­ é‡è¦ç¨‹åº¦ï¼šğŸ”¥ğŸ”¥ğŸ”¥**
Canaläº‹ä»¶å¤„ç†æœºåˆ¶æ˜¯æ•´ä¸ªæ•°æ®åŒæ­¥ä½“ç³»çš„æ ¸å¿ƒï¼ŒæŒæ¡è¿™ä¸ªæœºåˆ¶ç­‰äºæŒæ¡äº†ç°ä»£æ•°æ®åŒæ­¥çš„åŸºç¡€ã€‚

---

## 2. ğŸ“‹ binlogäº‹ä»¶ç±»å‹è§£æ


### 2.1 MySQL binlogäº‹ä»¶åˆ†ç±»


**ğŸ”¸ æ ¸å¿ƒäº‹ä»¶ç±»å‹**
binlogä¸­è®°å½•çš„äº‹ä»¶ç±»å‹å°±åƒä¸åŒç±»å‹çš„"åŠ¨ä½œæŒ‡ä»¤"ï¼Œå‘Šè¯‰æˆ‘ä»¬æ•°æ®åº“å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼š

```
æ ¸å¿ƒæ•°æ®å˜æ›´äº‹ä»¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº‹ä»¶ç±»å‹      â”‚     å«ä¹‰         â”‚    è§¦å‘åœºæ™¯      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WRITE_ROWS      â”‚ æ’å…¥æ•°æ®è¡Œ       â”‚ INSERTè¯­å¥      â”‚
â”‚ UPDATE_ROWS     â”‚ æ›´æ–°æ•°æ®è¡Œ       â”‚ UPDATEè¯­å¥      â”‚
â”‚ DELETE_ROWS     â”‚ åˆ é™¤æ•°æ®è¡Œ       â”‚ DELETEè¯­å¥      â”‚
â”‚ QUERY           â”‚ DDLè¯­å¥æ‰§è¡Œ      â”‚ CREATE/ALTERç­‰  â”‚
â”‚ TABLE_MAP       â”‚ è¡¨ç»“æ„æ˜ å°„       â”‚ DMLè¯­å¥å‰ç½®     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ å®é™…æ¡ˆä¾‹è§£æ**
```sql
-- æ‰§è¡Œè¿™æ¡SQL
INSERT INTO users (id, name, age) VALUES (1, 'å¼ ä¸‰', 25);

-- Canalè§£æåˆ°çš„äº‹ä»¶
äº‹ä»¶ç±»å‹: WRITE_ROWS
è¡¨å: users
æ•°æ®: {id: 1, name: 'å¼ ä¸‰', age: 25}
æ—¶é—´æˆ³: 2025-09-09 15:30:00
```

### 2.2 äº‹ä»¶ç»“æ„è¯¦è§£


**ğŸ“Š äº‹ä»¶çš„åŸºæœ¬ç»“æ„**
æ¯ä¸ªbinlogäº‹ä»¶å°±åƒä¸€ä¸ªåŒ…è£…ç›’ï¼Œé‡Œé¢è£…ç€å…·ä½“çš„æ•°æ®å˜åŒ–ä¿¡æ¯ï¼š

```
Canaläº‹ä»¶ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             äº‹ä»¶å¤´éƒ¨                â”‚ â† åŸºç¡€ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ äº‹ä»¶ç±»å‹                          â”‚
â”‚ â€¢ æ—¶é—´æˆ³                            â”‚
â”‚ â€¢ æœåŠ¡å™¨ID                          â”‚
â”‚ â€¢ æ—¥å¿—ä½ç½®                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             äº‹ä»¶ä½“                  â”‚ â† å…·ä½“æ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ•°æ®åº“å                          â”‚
â”‚ â€¢ è¡¨å                              â”‚
â”‚ â€¢ å˜æ›´å‰æ•°æ®(UPDATE/DELETE)         â”‚
â”‚ â€¢ å˜æ›´åæ•°æ®(INSERT/UPDATE)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ ä»£ç ç¤ºä¾‹ï¼šäº‹ä»¶è§£æ**
```java
// Canaläº‹ä»¶å¯¹è±¡ç¤ºä¾‹
public class CanalEvent {
    private String database;        // æ•°æ®åº“å
    private String table;          // è¡¨å
    private EventType eventType;   // äº‹ä»¶ç±»å‹
    private Long timestamp;        // æ—¶é—´æˆ³
    private List<Map<String, Object>> beforeData;  // å˜æ›´å‰æ•°æ®
    private List<Map<String, Object>> afterData;   // å˜æ›´åæ•°æ®
    
    // åˆ¤æ–­æ˜¯å¦ä¸ºæ’å…¥äº‹ä»¶
    public boolean isInsert() {
        return EventType.INSERT.equals(eventType);
    }
}
```

### 2.3 äº‹ä»¶ç±»å‹è¯†åˆ«ç®—æ³•


**ğŸ” äº‹ä»¶è¯†åˆ«é€»è¾‘**
Canalé€šè¿‡åˆ†æbinlogçš„äº‹ä»¶å¤´éƒ¨ä¿¡æ¯æ¥è¯†åˆ«äº‹ä»¶ç±»å‹ï¼š

```
äº‹ä»¶è¯†åˆ«æµç¨‹ï¼š
è¯»å–binlog â†’ è§£æäº‹ä»¶å¤´ â†’ è¯†åˆ«äº‹ä»¶ç±»å‹ â†’ æå–äº‹ä»¶æ•°æ®

åˆ¤æ–­é€»è¾‘ï¼š
if (äº‹ä»¶ç  == 23) â†’ WRITE_ROWSäº‹ä»¶ (INSERT)
if (äº‹ä»¶ç  == 24) â†’ UPDATE_ROWSäº‹ä»¶ (UPDATE) 
if (äº‹ä»¶ç  == 25) â†’ DELETE_ROWSäº‹ä»¶ (DELETE)
if (äº‹ä»¶ç  == 2)  â†’ QUERYäº‹ä»¶ (DDLè¯­å¥)
```

**âš ï¸ é‡è¦æé†’**
> ä¸åŒMySQLç‰ˆæœ¬çš„äº‹ä»¶ç å¯èƒ½æœ‰å·®å¼‚ï¼ŒCanalä¼šè‡ªåŠ¨é€‚é…ä¸åŒç‰ˆæœ¬çš„binlogæ ¼å¼ã€‚

---

## 3. ğŸ¯ äº‹ä»¶è¿‡æ»¤ç®—æ³•


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶è¿‡æ»¤


**ğŸ¤” ä¸šåŠ¡åœºæ™¯**
å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸éœ€è¦åŒæ­¥æ‰€æœ‰çš„æ•°æ®å˜åŒ–ï¼Œæ¯”å¦‚ï¼š
- åªå…³å¿ƒç”¨æˆ·è¡¨çš„å˜åŒ–ï¼Œä¸å…³å¿ƒæ—¥å¿—è¡¨
- åªåŒæ­¥é‡è¦ä¸šåŠ¡æ•°æ®ï¼Œå¿½ç•¥ä¸´æ—¶æ•°æ®
- è¿‡æ»¤æ‰ç³»ç»Ÿè‡ªåŠ¨äº§ç”Ÿçš„å˜æ›´

**ğŸ“ˆ è¿‡æ»¤çš„ä»·å€¼**
```
æ€§èƒ½æå‡ï¼š
âŒ ä¸è¿‡æ»¤ï¼šåŒæ­¥æ‰€æœ‰äº‹ä»¶ â†’ ç½‘ç»œå¸¦å®½æµªè´¹ã€å¤„ç†å»¶è¿Ÿ
âœ… æ™ºèƒ½è¿‡æ»¤ï¼šåªåŒæ­¥éœ€è¦çš„ â†’ å‡å°‘90%æ— ç”¨æ•°æ®ä¼ è¾“

ä¸šåŠ¡èšç„¦ï¼š
âŒ å…¨é‡åŒæ­¥ï¼šä¸šåŠ¡é€»è¾‘å¤æ‚ â†’ ä¸‹æ¸¸å¤„ç†å›°éš¾
âœ… ç²¾å‡†è¿‡æ»¤ï¼šåªæ”¶åˆ°å…³å¿ƒçš„ â†’ ä¸šåŠ¡é€»è¾‘ç®€åŒ–
```

### 3.2 Canalè¿‡æ»¤ç®—æ³•å®ç°


**ğŸ”§ å¤šå±‚æ¬¡è¿‡æ»¤æœºåˆ¶**
Canalé‡‡ç”¨å¤šå±‚è¿‡æ»¤ï¼Œå°±åƒæœºåœºå®‰æ£€ä¸€æ ·ï¼Œå±‚å±‚ç­›é€‰ï¼š

```
è¿‡æ»¤å±‚æ¬¡æ¶æ„ï¼š
æ•°æ®åº“çº§è¿‡æ»¤ â†’ è¡¨çº§è¿‡æ»¤ â†’ å­—æ®µçº§è¿‡æ»¤ â†’ äº‹ä»¶ç±»å‹è¿‡æ»¤
      â†“            â†“           â†“            â†“
   åªç›‘å¬æŒ‡å®šåº“   åªç›‘å¬æŒ‡å®šè¡¨  åªç›‘å¬æŒ‡å®šå­—æ®µ  åªå¤„ç†æŒ‡å®šæ“ä½œ
```

**ğŸ’» é…ç½®ç¤ºä¾‹**
```properties
# Canalè¿‡æ»¤é…ç½®
canal.instance.filter.regex = test\\.user.*,test\\.order.*
# å«ä¹‰ï¼šåªç›‘å¬teståº“ä¸‹çš„userå’Œorderç›¸å…³è¡¨

# æ›´ç²¾ç»†çš„è¿‡æ»¤
canal.instance.filter.black.regex = test\\.temp.*,.*\\.log.*  
# å«ä¹‰ï¼šæ’é™¤ä¸´æ—¶è¡¨å’Œæ—¥å¿—è¡¨
```

### 3.3 è‡ªå®šä¹‰è¿‡æ»¤å™¨å¼€å‘


**ğŸ› ï¸ ä¸šåŠ¡çº§è¿‡æ»¤å™¨**
æœ‰æ—¶å€™Canalå†…ç½®çš„è¿‡æ»¤è¿˜ä¸å¤Ÿï¼Œéœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡é€»è¾‘è¿‡æ»¤ï¼š

```java
// è‡ªå®šä¹‰äº‹ä»¶è¿‡æ»¤å™¨
public class BusinessEventFilter implements EventFilter {
    
    @Override
    public boolean filter(CanalEntry.Entry entry) {
        // åªå¤„ç†é‡è¦ç”¨æˆ·çš„æ•°æ®å˜æ›´
        if ("users".equals(entry.getTableName())) {
            return isImportantUser(entry);
        }
        
        // åªå¤„ç†å¤§é¢è®¢å•å˜æ›´
        if ("orders".equals(entry.getTableName())) {
            return isLargeOrder(entry);
        }
        
        return true;  // é»˜è®¤é€šè¿‡
    }
    
    private boolean isImportantUser(CanalEntry.Entry entry) {
        // æ£€æŸ¥ç”¨æˆ·çº§åˆ«å­—æ®µ
        return checkUserLevel(entry.getAfterColumnsList());
    }
}
```

**ğŸ¯ è¿‡æ»¤ç®—æ³•ä¼˜åŒ–**
```
ç®—æ³•ä¼˜åŒ–åŸåˆ™ï¼š
1. æ—©æœŸè¿‡æ»¤ï¼šåœ¨æ•°æ®è§£æå‰å°±è¿‡æ»¤ â†’ èŠ‚çœCPU
2. ç®€å•ä¼˜å…ˆï¼šå…ˆæ‰§è¡Œç®€å•åˆ¤æ–­ â†’ æé«˜æ•ˆç‡  
3. ç¼“å­˜ç»“æœï¼šé‡å¤åˆ¤æ–­ä½¿ç”¨ç¼“å­˜ â†’ é¿å…é‡å¤è®¡ç®—
```

---

## 4. ğŸ”„ äº‹ä»¶è½¬æ¢å¤„ç†


### 4.1 äº‹ä»¶è½¬æ¢çš„å¿…è¦æ€§


**ğŸ”¸ åŸå§‹äº‹ä»¶çš„é—®é¢˜**
Canalè§£æå‡ºçš„åŸå§‹äº‹ä»¶æ˜¯åº•å±‚çš„binlogæ ¼å¼ï¼Œä¸é€‚åˆç›´æ¥ç»™ä¸šåŠ¡ç³»ç»Ÿä½¿ç”¨ï¼š

```
åŸå§‹äº‹ä»¶é—®é¢˜ï¼š
âŒ æ ¼å¼å¤æ‚ï¼šåŒ…å«å¤§é‡æŠ€æœ¯ç»†èŠ‚
âŒ å­—æ®µååº•å±‚ï¼šæ¯”å¦‚ä½¿ç”¨æ•°å­—ç´¢å¼•è€Œä¸æ˜¯å­—æ®µå
âŒ ç±»å‹æ··ä¹±ï¼šæ‰€æœ‰å­—æ®µéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹
âŒ ç¼ºå°‘è¯­ä¹‰ï¼šä¸çŸ¥é“è¿™ä¸ªå˜æ›´çš„ä¸šåŠ¡å«ä¹‰
```

**âœ… è½¬æ¢åçš„ä¼˜åŠ¿**
```
è½¬æ¢åçš„äº‹ä»¶ï¼š
âœ… ç»“æ„æ¸…æ™°ï¼šåªä¿ç•™ä¸šåŠ¡éœ€è¦çš„ä¿¡æ¯
âœ… ç±»å‹æ­£ç¡®ï¼šæ•°å­—å°±æ˜¯æ•°å­—ï¼Œæ—¥æœŸå°±æ˜¯æ—¥æœŸ
âœ… è¯­ä¹‰æ˜ç¡®ï¼šç›´æ¥è¡¨è¾¾ä¸šåŠ¡æ“ä½œå«ä¹‰
âœ… æ˜“äºå¤„ç†ï¼šä¸‹æ¸¸ç³»ç»Ÿç›´æ¥ä½¿ç”¨
```

### 4.2 äº‹ä»¶è½¬æ¢æµç¨‹


**ğŸ“Š è½¬æ¢å¤„ç†æµæ°´çº¿**
```
åŸå§‹binlogäº‹ä»¶ â†’ æ•°æ®ç±»å‹è½¬æ¢ â†’ å­—æ®µæ˜ å°„ â†’ ä¸šåŠ¡è¯­ä¹‰å¢å¼º â†’ æ ‡å‡†äº‹ä»¶æ ¼å¼
      â†“              â†“           â†“          â†“            â†“
   æŠ€æœ¯æ ¼å¼        æ­£ç¡®ç±»å‹     ä¸šåŠ¡å­—æ®µå   ä¸šåŠ¡æ“ä½œ     ä¸šåŠ¡äº‹ä»¶
```

**ğŸ’» è½¬æ¢å®ç°ç¤ºä¾‹**
```java
public class EventTransformer {
    
    // è½¬æ¢UPDATEäº‹ä»¶
    public BusinessEvent transformUpdate(CanalEntry.Entry entry) {
        BusinessEvent event = new BusinessEvent();
        
        // åŸºç¡€ä¿¡æ¯è½¬æ¢
        event.setDatabase(entry.getDatabase());
        event.setTable(entry.getTable());
        event.setOperationType("UPDATE");
        event.setTimestamp(new Date(entry.getHeader().getExecuteTime()));
        
        // æ•°æ®è½¬æ¢
        Map<String, Object> beforeData = convertRowData(entry.getBeforeColumnsList());
        Map<String, Object> afterData = convertRowData(entry.getAfterColumnsList());
        
        event.setBeforeData(beforeData);
        event.setAfterData(afterData);
        
        // ä¸šåŠ¡è¯­ä¹‰å¢å¼º
        enhanceBusinessSemantics(event);
        
        return event;
    }
    
    // æ•°æ®ç±»å‹è½¬æ¢
    private Map<String, Object> convertRowData(List<CanalEntry.Column> columns) {
        Map<String, Object> data = new HashMap<>();
        
        for (CanalEntry.Column column : columns) {
            String name = column.getName();
            String value = column.getValue();
            
            // æ ¹æ®å­—æ®µç±»å‹è½¬æ¢
            Object convertedValue = convertByType(column.getSqlType(), value);
            data.put(name, convertedValue);
        }
        
        return data;
    }
}
```

### 4.3 ä¸šåŠ¡è¯­ä¹‰å¢å¼º


**ğŸ¯ å¢å¼ºä¸šåŠ¡å«ä¹‰**
åŸå§‹äº‹ä»¶åªå‘Šè¯‰æˆ‘ä»¬"æŸä¸ªå­—æ®µå˜äº†"ï¼Œä¸šåŠ¡è¯­ä¹‰å¢å¼ºå‘Šè¯‰æˆ‘ä»¬"ç”¨æˆ·ç­‰çº§æå‡äº†"ï¼š

```java
// ä¸šåŠ¡è¯­ä¹‰å¢å¼ºç¤ºä¾‹
private void enhanceBusinessSemantics(BusinessEvent event) {
    if ("users".equals(event.getTable())) {
        enhanceUserEvent(event);
    } else if ("orders".equals(event.getTable())) {
        enhanceOrderEvent(event);
    }
}

private void enhanceUserEvent(BusinessEvent event) {
    Object beforeLevel = event.getBeforeData().get("level");
    Object afterLevel = event.getAfterData().get("level");
    
    if (beforeLevel != null && afterLevel != null) {
        if ((Integer)afterLevel > (Integer)beforeLevel) {
            event.setBusinessAction("USER_LEVEL_UP");  // ç”¨æˆ·å‡çº§
        } else if ((Integer)afterLevel < (Integer)beforeLevel) {
            event.setBusinessAction("USER_LEVEL_DOWN");  // ç”¨æˆ·é™çº§
        }
    }
}
```

**ğŸ¨ è½¬æ¢é…ç½®åŒ–**
```yaml
# äº‹ä»¶è½¬æ¢é…ç½®
transform:
  tables:
    users:
      fields:
        level: 
          type: integer
          business_rules:
            - name: level_change
              condition: before != after
              action: USER_LEVEL_CHANGE
    orders:
      fields:
        status:
          type: string
          business_rules:
            - name: order_paid
              condition: after == 'PAID'
              action: ORDER_PAYMENT_SUCCESS
```

---

## 5. ğŸ’¾ äº‹ä»¶åºåˆ—åŒ–æœºåˆ¶


### 5.1 åºåˆ—åŒ–çš„ä½œç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯åºåˆ—åŒ–**
åºåˆ—åŒ–å°±æ˜¯æŠŠå†…å­˜ä¸­çš„äº‹ä»¶å¯¹è±¡è½¬æ¢æˆå¯ä»¥ä¼ è¾“å’Œå­˜å‚¨çš„æ ¼å¼ï¼Œå°±åƒæŠŠç‰©å“æ‰“åŒ…è£…ç®±ä¸€æ ·ã€‚

```
åºåˆ—åŒ–è¿‡ç¨‹ï¼š
å†…å­˜ä¸­çš„äº‹ä»¶å¯¹è±¡ â†’ åºåˆ—åŒ– â†’ å­—èŠ‚æµ/JSON/Avro â†’ ç½‘ç»œä¼ è¾“/ç£ç›˜å­˜å‚¨
       â†“               â†“           â†“              â†“
    Javaå¯¹è±¡         äºŒè¿›åˆ¶æ ¼å¼   å¯ä¼ è¾“æ ¼å¼      æŒä¹…åŒ–å­˜å‚¨
```

**ğŸ¯ åºåˆ—åŒ–çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–ï¼Ÿ
âœ… ç½‘ç»œä¼ è¾“ï¼šå¯¹è±¡ä¸èƒ½ç›´æ¥åœ¨ç½‘ç»œä¼ è¾“
âœ… æŒä¹…åŒ–å­˜å‚¨ï¼šå†…å­˜å¯¹è±¡æ–­ç”µå°±æ¶ˆå¤±
âœ… è·¨è¯­è¨€äº¤äº’ï¼šJavaå¯¹è±¡å…¶ä»–è¯­è¨€ä¸è®¤è¯†
âœ… æ€§èƒ½ä¼˜åŒ–ï¼šåˆé€‚çš„åºåˆ—åŒ–æ ¼å¼æå‡æ€§èƒ½
```

### 5.2 Canalæ”¯æŒçš„åºåˆ—åŒ–æ ¼å¼


**ğŸ“‹ åºåˆ—åŒ–æ ¼å¼å¯¹æ¯”**

| æ ¼å¼ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **JSON** | ğŸŸ¢ æ˜“è¯»ã€é€šç”¨ | ğŸ”´ ä½“ç§¯å¤§ã€æ€§èƒ½ä¸€èˆ¬ | å¼€å‘è°ƒè¯•ã€ç®€å•é›†æˆ |
| **Avro** | ğŸŸ¢ å‹ç¼©ç‡é«˜ã€æ”¯æŒSchema | ğŸ”´ å­¦ä¹ æˆæœ¬é«˜ | å¤§æ•°æ®åœºæ™¯ã€æ€§èƒ½è¦æ±‚é«˜ |
| **Protobuf** | ğŸŸ¢ æ€§èƒ½å¥½ã€ä½“ç§¯å° | ğŸ”´ éœ€è¦å®šä¹‰Schema | å¾®æœåŠ¡é—´é€šä¿¡ |
| **CanalåŸç”Ÿ** | ğŸŸ¢ æœ€é€‚åˆCanal | ğŸ”´ åªèƒ½Canalç”¨ | Canalç”Ÿæ€å†…éƒ¨ |

**ğŸ’» åºåˆ—åŒ–é…ç½®ç¤ºä¾‹**
```properties
# Canalé…ç½®ä¸åŒçš„åºåˆ—åŒ–æ ¼å¼
canal.instance.parser.parallel = true

# ä½¿ç”¨JSONæ ¼å¼
canal.instance.tsdb.enable = true  
canal.serverMode = tcp

# ä½¿ç”¨Avroæ ¼å¼  
canal.instance.parser.parallelThreadSize = 16
canal.mq.topic = canal-topic
canal.mq.partition = 0
```

### 5.3 è‡ªå®šä¹‰åºåˆ—åŒ–å™¨


**ğŸ› ï¸ å®ç°è‡ªå®šä¹‰åºåˆ—åŒ–**
æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„åºåˆ—åŒ–æ ¼å¼ï¼š

```java
// è‡ªå®šä¹‰åºåˆ—åŒ–å™¨
public class BusinessEventSerializer implements EventSerializer {
    
    private ObjectMapper objectMapper = new ObjectMapper();
    
    @Override
    public byte[] serialize(Object event) {
        try {
            // åªåºåˆ—åŒ–ä¸šåŠ¡å…³å¿ƒçš„å­—æ®µ
            BusinessEventDto dto = convertToDto((BusinessEvent) event);
            return objectMapper.writeValueAsBytes(dto);
        } catch (Exception e) {
            throw new SerializationException("åºåˆ—åŒ–å¤±è´¥", e);
        }
    }
    
    // è½¬æ¢ä¸ºä¼ è¾“å¯¹è±¡ï¼ŒåªåŒ…å«å¿…è¦å­—æ®µ
    private BusinessEventDto convertToDto(BusinessEvent event) {
        BusinessEventDto dto = new BusinessEventDto();
        dto.setTable(event.getTable());
        dto.setAction(event.getBusinessAction());
        dto.setTimestamp(event.getTimestamp());
        dto.setKeyData(extractKeyData(event));  // åªä¼ è¾“å…³é”®æ•°æ®
        return dto;
    }
}
```

**âš¡ åºåˆ—åŒ–æ€§èƒ½ä¼˜åŒ–**
```
æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼š
ğŸš€ å­—æ®µç­›é€‰ï¼šåªåºåˆ—åŒ–å¿…è¦å­—æ®µ â†’ å‡å°‘æ•°æ®é‡
ğŸš€ æ‰¹é‡åºåˆ—åŒ–ï¼šä¸€æ¬¡åºåˆ—åŒ–å¤šä¸ªäº‹ä»¶ â†’ æé«˜ååé‡
ğŸš€ å‹ç¼©ç®—æ³•ï¼šä½¿ç”¨gzipå‹ç¼© â†’ å‡å°‘ç½‘ç»œä¼ è¾“
ğŸš€ å¯¹è±¡æ± ï¼šé‡ç”¨åºåˆ—åŒ–å¯¹è±¡ â†’ å‡å°‘GCå‹åŠ›
```

---

## 6. ğŸ—„ï¸ äº‹ä»¶å­˜å‚¨ä¼˜åŒ–


### 6.1 äº‹ä»¶å­˜å‚¨çš„æŒ‘æˆ˜


**ğŸ”¸ å­˜å‚¨é¢ä¸´çš„é—®é¢˜**
Canalå¤„ç†çš„äº‹ä»¶é‡é€šå¸¸å¾ˆå¤§ï¼Œå­˜å‚¨è®¾è®¡ä¸å½“ä¼šå¯¼è‡´ä¸¥é‡é—®é¢˜ï¼š

```
å¸¸è§å­˜å‚¨é—®é¢˜ï¼š
âŒ ç£ç›˜ç©ºé—´ä¸è¶³ï¼šäº‹ä»¶ç´¯ç§¯å¯¼è‡´ç£ç›˜çˆ†æ»¡
âŒ æŸ¥è¯¢æ€§èƒ½å·®ï¼šå†å²äº‹ä»¶æŸ¥è¯¢å¾ˆæ…¢
âŒ æ•°æ®ä¸¢å¤±é£é™©ï¼šå­˜å‚¨æ•…éšœå¯¼è‡´äº‹ä»¶ä¸¢å¤±
âŒ æ¸…ç†å›°éš¾ï¼šæ—§æ•°æ®æ¸…ç†æœºåˆ¶ä¸å®Œå–„
```

**âœ… ä¼˜åŒ–å­˜å‚¨çš„ä»·å€¼**
```
å­˜å‚¨ä¼˜åŒ–æ”¶ç›Šï¼š
âœ… ç©ºé—´èŠ‚çœï¼šä¼˜åŒ–å­˜å‚¨æ ¼å¼ï¼ŒèŠ‚çœ50%ä»¥ä¸Šç©ºé—´
âœ… æŸ¥è¯¢åŠ é€Ÿï¼šåˆç†ç´¢å¼•è®¾è®¡ï¼ŒæŸ¥è¯¢æ€§èƒ½æå‡10å€
âœ… å¯é æ€§æå‡ï¼šå¤šå‰¯æœ¬æœºåˆ¶ï¼Œé¿å…æ•°æ®ä¸¢å¤±
âœ… è¿ç»´ç®€åŒ–ï¼šè‡ªåŠ¨åŒ–æ¸…ç†ï¼Œé™ä½è¿ç»´æˆæœ¬
```

### 6.2 åˆ†å±‚å­˜å‚¨ç­–ç•¥


**ğŸ“Š çƒ­æ¸©å†·æ•°æ®åˆ†å±‚**
æ ¹æ®æ•°æ®è®¿é—®é¢‘ç‡ï¼Œé‡‡ç”¨ä¸åŒçš„å­˜å‚¨ç­–ç•¥ï¼š

```
åˆ†å±‚å­˜å‚¨æ¶æ„ï¼š
çƒ­æ•°æ®(æœ€è¿‘7å¤©)    â†’ å†…å­˜+SSD     â†’ æ¯«ç§’çº§è®¿é—®
    â†“
æ¸©æ•°æ®(æœ€è¿‘3ä¸ªæœˆ)  â†’ æœºæ¢°ç¡¬ç›˜     â†’ ç§’çº§è®¿é—®  
    â†“
å†·æ•°æ®(3ä¸ªæœˆä»¥ä¸Š)  â†’ å¯¹è±¡å­˜å‚¨     â†’ åˆ†é’Ÿçº§è®¿é—®
    â†“
å½’æ¡£æ•°æ®(1å¹´ä»¥ä¸Š)  â†’ ç£å¸¦/å†·å­˜å‚¨  â†’ å°æ—¶çº§è®¿é—®
```

**ğŸ’» åˆ†å±‚å­˜å‚¨å®ç°**
```java
public class TieredEventStorage {
    
    private RedisTemplate hotStorage;      // çƒ­æ•°æ®å­˜å‚¨
    private JdbcTemplate warmStorage;      // æ¸©æ•°æ®å­˜å‚¨
    private S3Client coldStorage;          // å†·æ•°æ®å­˜å‚¨
    
    // æ™ºèƒ½å­˜å‚¨ç­–ç•¥
    public void storeEvent(BusinessEvent event) {
        // æœ€æ–°æ•°æ®å­˜å‚¨åˆ°çƒ­å­˜å‚¨
        storeToHot(event);
        
        // å¼‚æ­¥å°†æ•°æ®åˆ†å±‚
        CompletableFuture.runAsync(() -> {
            // 7å¤©åè¿ç§»åˆ°æ¸©å­˜å‚¨
            if (isOlderThan(event, 7, TimeUnit.DAYS)) {
                moveToWarm(event);
                removeFromHot(event);
            }
            
            // 3ä¸ªæœˆåè¿ç§»åˆ°å†·å­˜å‚¨
            if (isOlderThan(event, 90, TimeUnit.DAYS)) {
                moveToCold(event);
                removeFromWarm(event);
            }
        });
    }
    
    // æ™ºèƒ½æŸ¥è¯¢ç­–ç•¥
    public BusinessEvent queryEvent(String eventId, Date timestamp) {
        // æ ¹æ®æ—¶é—´æˆ³é€‰æ‹©åˆé€‚çš„å­˜å‚¨å±‚
        if (isRecent(timestamp, 7)) {
            return queryFromHot(eventId);
        } else if (isRecent(timestamp, 90)) {
            return queryFromWarm(eventId);
        } else {
            return queryFromCold(eventId);
        }
    }
}
```

### 6.3 å­˜å‚¨æ ¼å¼ä¼˜åŒ–


**ğŸ—œï¸ æ•°æ®å‹ç¼©ç­–ç•¥**
```
å‹ç¼©ä¼˜åŒ–æ–¹æ¡ˆï¼š
ğŸ“¦ å­—æ®µå‹ç¼©ï¼šé‡å¤å­—æ®µä½¿ç”¨å­—å…¸ç¼–ç 
ğŸ“¦ æ‰¹é‡å‹ç¼©ï¼šå¤šä¸ªäº‹ä»¶ä¸€èµ·å‹ç¼©
ğŸ“¦ å¢é‡å‹ç¼©ï¼šåªå­˜å‚¨å˜åŒ–çš„å­—æ®µ
ğŸ“¦ æ ¼å¼ä¼˜åŒ–ï¼šä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼æ›¿ä»£JSON
```

**ğŸ’¾ å­˜å‚¨ä¼˜åŒ–é…ç½®**
```yaml
# å­˜å‚¨ä¼˜åŒ–é…ç½®
storage:
  hot_tier:
    type: redis_cluster
    ttl: 7d
    compression: none
    
  warm_tier:
    type: mysql
    table_sharding: true    # åˆ†è¡¨å­˜å‚¨
    index_strategy: time_based
    compression: gzip
    
  cold_tier:
    type: s3
    compression: lz4
    batch_size: 1000       # æ‰¹é‡å­˜å‚¨
    
  cleanup:
    auto_cleanup: true
    retention_policy: 1y   # ä¿ç•™1å¹´
```

---

## 7. ğŸ”„ äº‹ä»¶å¤„ç†æµæ°´çº¿


### 7.1 æµæ°´çº¿è®¾è®¡æ€æƒ³


**ğŸ”¸ ä»€ä¹ˆæ˜¯äº‹ä»¶å¤„ç†æµæ°´çº¿**
äº‹ä»¶å¤„ç†æµæ°´çº¿å°±åƒå·¥å‚çš„è£…é…çº¿ï¼Œæ¯ä¸ªç¯èŠ‚è´Ÿè´£ä¸€ä¸ªç‰¹å®šçš„å¤„ç†æ­¥éª¤ï¼Œæœ€ç»ˆç»„è£…å‡ºå®Œæ•´çš„äº§å“ï¼ˆå¤„ç†å¥½çš„äº‹ä»¶ï¼‰ã€‚

```
Canaläº‹ä»¶å¤„ç†æµæ°´çº¿ï¼š
binlogè¯»å– â†’ äº‹ä»¶è§£æ â†’ äº‹ä»¶è¿‡æ»¤ â†’ äº‹ä»¶è½¬æ¢ â†’ äº‹ä»¶åˆ†å‘ â†’ ä¸‹æ¸¸æ¶ˆè´¹
    â†“          â†“         â†“         â†“         â†“         â†“
  åŸå§‹æ—¥å¿—   ç»“æ„åŒ–äº‹ä»¶   æœ‰æ•ˆäº‹ä»¶   ä¸šåŠ¡äº‹ä»¶   æ¶ˆæ¯é˜Ÿåˆ—   ä¸šåŠ¡å¤„ç†
```

**ğŸ¯ æµæ°´çº¿çš„ä¼˜åŠ¿**
```
å¹¶è¡Œå¤„ç†ï¼š
âŒ ä¸²è¡Œå¤„ç†ï¼šä¸€ä¸ªäº‹ä»¶å¤„ç†å®Œå†å¤„ç†ä¸‹ä¸€ä¸ª â†’ ååé‡ä½
âœ… æµæ°´çº¿ï¼šå¤šä¸ªäº‹ä»¶åŒæ—¶åœ¨ä¸åŒé˜¶æ®µå¤„ç† â†’ ååé‡é«˜

è§£è€¦è®¾è®¡ï¼š
âŒ ç´§è€¦åˆï¼šæ‰€æœ‰é€»è¾‘å†™åœ¨ä¸€èµ· â†’ éš¾ä»¥ç»´æŠ¤
âœ… æµæ°´çº¿ï¼šæ¯ä¸ªç¯èŠ‚ç‹¬ç«‹ â†’ æ˜“äºæ‰©å±•å’Œç»´æŠ¤
```

### 7.2 æµæ°´çº¿æ¶æ„è®¾è®¡


**ğŸ—ï¸ å¤šçº¿ç¨‹æµæ°´çº¿å®ç°**
```java
public class EventProcessingPipeline {
    
    // ä¸åŒé˜¶æ®µçš„çº¿ç¨‹æ± 
    private ThreadPoolExecutor parsePool;      // è§£æçº¿ç¨‹æ± 
    private ThreadPoolExecutor filterPool;     // è¿‡æ»¤çº¿ç¨‹æ±   
    private ThreadPoolExecutor transformPool;  // è½¬æ¢çº¿ç¨‹æ± 
    private ThreadPoolExecutor dispatchPool;   // åˆ†å‘çº¿ç¨‹æ± 
    
    // é˜¶æ®µé—´çš„ç¼“å†²é˜Ÿåˆ—
    private BlockingQueue<RawEvent> parseQueue;
    private BlockingQueue<ParsedEvent> filterQueue;
    private BlockingQueue<FilteredEvent> transformQueue;
    private BlockingQueue<TransformedEvent> dispatchQueue;
    
    public void processBinlogEvent(byte[] binlogData) {
        // æäº¤åˆ°è§£æé˜¶æ®µ
        parseQueue.offer(new RawEvent(binlogData));
    }
    
    // è§£æé˜¶æ®µ
    private class ParseStage implements Runnable {
        public void run() {
            while (true) {
                RawEvent rawEvent = parseQueue.take();
                ParsedEvent parsedEvent = parseEvent(rawEvent);
                filterQueue.offer(parsedEvent);
            }
        }
    }
    
    // è¿‡æ»¤é˜¶æ®µ
    private class FilterStage implements Runnable {
        public void run() {
            while (true) {
                ParsedEvent event = filterQueue.take();
                if (shouldProcess(event)) {
                    transformQueue.offer(new FilteredEvent(event));
                }
            }
        }
    }
}
```

### 7.3 æµæ°´çº¿æ€§èƒ½ä¼˜åŒ–


**âš¡ æ€§èƒ½è°ƒä¼˜ç­–ç•¥**
```
ç¼“å†²åŒºä¼˜åŒ–ï¼š
ğŸš€ åˆç†ç¼“å†²åŒºå¤§å°ï¼šé¿å…å†…å­˜æº¢å‡ºå’Œé˜»å¡
ğŸš€ èƒŒå‹å¤„ç†ï¼šä¸Šæ¸¸äº§ç”Ÿè¿‡å¿«æ—¶çš„é™çº§ç­–ç•¥
ğŸš€ æ‰¹é‡å¤„ç†ï¼šä¸€æ¬¡å¤„ç†å¤šä¸ªäº‹ä»¶æé«˜æ•ˆç‡

çº¿ç¨‹æ± ä¼˜åŒ–ï¼š
ğŸš€ çº¿ç¨‹æ•°è°ƒä¼˜ï¼šæ ¹æ®CPUæ ¸æ•°å’ŒIOå¯†é›†ç¨‹åº¦è°ƒæ•´
ğŸš€ é˜Ÿåˆ—é€‰æ‹©ï¼šé€‰æ‹©åˆé€‚çš„é˜»å¡é˜Ÿåˆ—ç±»å‹
ğŸš€ æ‹’ç»ç­–ç•¥ï¼šå¤„ç†ä¸è¿‡æ¥æ—¶çš„åº”å¯¹ç­–ç•¥
```

**ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```yaml
# æµæ°´çº¿ç›‘æ§æŒ‡æ ‡
pipeline_metrics:
  stages:
    parse:
      throughput: 10000 events/sec    # ååé‡
      latency_p99: 50ms              # 99%å»¶è¿Ÿ
      queue_depth: 1000              # é˜Ÿåˆ—æ·±åº¦
      
    filter:  
      throughput: 15000 events/sec
      filter_rate: 30%               # è¿‡æ»¤ç‡
      
    transform:
      throughput: 12000 events/sec
      error_rate: 0.01%              # é”™è¯¯ç‡
```

---

## 8. ğŸ› ï¸ è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨


### 8.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å¤„ç†å™¨


**ğŸ”¸ æ ‡å‡†å¤„ç†å™¨çš„å±€é™æ€§**
Canalæä¾›çš„æ ‡å‡†äº‹ä»¶å¤„ç†å™¨è™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ— æ³•æ»¡è¶³æ‰€æœ‰ä¸šåŠ¡åœºæ™¯ï¼š

```
ä¸šåŠ¡åœºæ™¯ä¸¾ä¾‹ï¼š
âŒ æ ‡å‡†å¤„ç†å™¨ï¼šåªèƒ½åŒæ­¥åˆ°Kafkaã€RocketMQç­‰
âœ… è‡ªå®šä¹‰éœ€æ±‚ï¼šåŒæ­¥åˆ°ä¼ä¸šå†…éƒ¨æ¶ˆæ¯ç³»ç»Ÿ

âŒ æ ‡å‡†å¤„ç†å™¨ï¼šæŒ‰åŸå§‹æ•°æ®æ ¼å¼åŒæ­¥
âœ… è‡ªå®šä¹‰éœ€æ±‚ï¼šéœ€è¦æ•°æ®è„±æ•ã€æ ¼å¼è½¬æ¢

âŒ æ ‡å‡†å¤„ç†å™¨ï¼šæ‰€æœ‰äº‹ä»¶éƒ½å¤„ç†
âœ… è‡ªå®šä¹‰éœ€æ±‚ï¼šå¤æ‚çš„ä¸šåŠ¡è§„åˆ™è¿‡æ»¤
```

**ğŸ¯ è‡ªå®šä¹‰å¤„ç†å™¨çš„ä»·å€¼**
```
ä¸šåŠ¡é€‚é…ï¼š
âœ… å®Œå…¨åŒ¹é…ä¸šåŠ¡éœ€æ±‚
âœ… é›†æˆä¼ä¸šç°æœ‰ç³»ç»Ÿ
âœ… å®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘

æ€§èƒ½ä¼˜åŒ–ï¼š
âœ… é’ˆå¯¹æ€§ä¼˜åŒ–
âœ… å‡å°‘ä¸å¿…è¦çš„è½¬æ¢
âœ… æ‰¹é‡å¤„ç†ä¼˜åŒ–
```

### 8.2 è‡ªå®šä¹‰å¤„ç†å™¨å¼€å‘


**ğŸ’» åŸºç¡€å¤„ç†å™¨æ¡†æ¶**
```java
// è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨æ¥å£
public interface CustomEventHandler {
    
    /**
     * å¤„ç†å•ä¸ªäº‹ä»¶
     */
    void handleEvent(CanalEntry.Entry entry);
    
    /**
     * æ‰¹é‡å¤„ç†äº‹ä»¶
     */
    default void handleBatch(List<CanalEntry.Entry> entries) {
        entries.forEach(this::handleEvent);
    }
    
    /**
     * å¤„ç†å™¨å¯åŠ¨
     */
    default void start() {}
    
    /**
     * å¤„ç†å™¨åœæ­¢
     */
    default void stop() {}
}

// ä¸šåŠ¡äº‹ä»¶å¤„ç†å™¨å®ç°
@Component
public class UserEventHandler implements CustomEventHandler {
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private MessageProducer messageProducer;
    
    @Override
    public void handleEvent(CanalEntry.Entry entry) {
        // åªå¤„ç†ç”¨æˆ·è¡¨çš„äº‹ä»¶
        if (!"users".equals(entry.getTableName())) {
            return;
        }
        
        try {
            // æ ¹æ®äº‹ä»¶ç±»å‹å¤„ç†
            switch (entry.getEventType()) {
                case INSERT:
                    handleUserCreate(entry);
                    break;
                case UPDATE:
                    handleUserUpdate(entry);
                    break;
                case DELETE:
                    handleUserDelete(entry);
                    break;
            }
        } catch (Exception e) {
            // é”™è¯¯å¤„ç†
            handleError(entry, e);
        }
    }
    
    private void handleUserCreate(CanalEntry.Entry entry) {
        // è§£ææ–°ç”¨æˆ·æ•°æ®
        UserInfo userInfo = parseUserInfo(entry);
        
        // å‘é€ç”¨æˆ·æ³¨å†Œäº‹ä»¶
        UserRegisteredEvent event = new UserRegisteredEvent(userInfo);
        messageProducer.send("user.registered", event);
        
        // è§¦å‘æ¬¢è¿æµç¨‹
        userService.triggerWelcomeProcess(userInfo.getId());
    }
}
```

### 8.3 é«˜çº§å¤„ç†å™¨ç‰¹æ€§


**ğŸš€ æ‰¹é‡å¤„ç†ä¼˜åŒ–**
```java
// æ”¯æŒæ‰¹é‡å¤„ç†çš„é«˜çº§å¤„ç†å™¨
public class BatchEventHandler implements CustomEventHandler {
    
    private List<CanalEntry.Entry> batchBuffer = new ArrayList<>();
    private int batchSize = 100;
    private long batchTimeout = 1000; // 1ç§’
    
    @Override
    public void handleEvent(CanalEntry.Entry entry) {
        synchronized (batchBuffer) {
            batchBuffer.add(entry);
            
            // è¾¾åˆ°æ‰¹é‡å¤§å°æˆ–è¶…æ—¶ï¼Œè§¦å‘æ‰¹é‡å¤„ç†
            if (batchBuffer.size() >= batchSize) {
                processBatch();
            }
        }
    }
    
    private void processBatch() {
        if (batchBuffer.isEmpty()) return;
        
        // æŒ‰è¡¨åˆ†ç»„æ‰¹é‡å¤„ç†
        Map<String, List<CanalEntry.Entry>> groupedEvents = 
            batchBuffer.stream()
                      .collect(Collectors.groupingBy(CanalEntry.Entry::getTableName));
        
        // å¹¶è¡Œå¤„ç†ä¸åŒè¡¨çš„äº‹ä»¶
        groupedEvents.entrySet().parallelStream().forEach(entry -> {
            String tableName = entry.getKey();
            List<CanalEntry.Entry> events = entry.getValue();
            processTableEvents(tableName, events);
        });
        
        batchBuffer.clear();
    }
}
```

**ğŸ”§ å¤„ç†å™¨é“¾æ¨¡å¼**
```java
// å¤„ç†å™¨é“¾ï¼šæ”¯æŒå¤šä¸ªå¤„ç†å™¨ä¸²è”
public class EventHandlerChain {
    
    private List<CustomEventHandler> handlers = new ArrayList<>();
    
    public void addHandler(CustomEventHandler handler) {
        handlers.add(handler);
    }
    
    public void processEvent(CanalEntry.Entry entry) {
        for (CustomEventHandler handler : handlers) {
            try {
                handler.handleEvent(entry);
            } catch (Exception e) {
                // è®°å½•é”™è¯¯ï¼Œä½†ç»§ç»­æ‰§è¡Œåç»­å¤„ç†å™¨
                log.error("å¤„ç†å™¨ {} æ‰§è¡Œå¤±è´¥", handler.getClass().getSimpleName(), e);
            }
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
EventHandlerChain chain = new EventHandlerChain();
chain.addHandler(new DataValidationHandler());    // æ•°æ®éªŒè¯
chain.addHandler(new DataTransformHandler());     // æ•°æ®è½¬æ¢
chain.addHandler(new MessageSendHandler());       // æ¶ˆæ¯å‘é€
chain.addHandler(new MetricsCollectHandler());    // æŒ‡æ ‡æ”¶é›†
```

### 8.4 å¤„ç†å™¨éƒ¨ç½²ä¸ç®¡ç†


**ğŸ“¦ æ’ä»¶åŒ–éƒ¨ç½²**
```java
// å¤„ç†å™¨æ’ä»¶ç®¡ç†å™¨
@Component
public class HandlerPluginManager {
    
    private Map<String, CustomEventHandler> handlers = new ConcurrentHashMap<>();
    
    // åŠ¨æ€åŠ è½½å¤„ç†å™¨
    public void loadHandler(String name, String className) {
        try {
            Class<?> clazz = Class.forName(className);
            CustomEventHandler handler = (CustomEventHandler) clazz.newInstance();
            
            handlers.put(name, handler);
            handler.start();
            
            log.info("å¤„ç†å™¨ {} åŠ è½½æˆåŠŸ", name);
        } catch (Exception e) {
            log.error("å¤„ç†å™¨ {} åŠ è½½å¤±è´¥", name, e);
        }
    }
    
    // åŠ¨æ€å¸è½½å¤„ç†å™¨
    public void unloadHandler(String name) {
        CustomEventHandler handler = handlers.remove(name);
        if (handler != null) {
            handler.stop();
            log.info("å¤„ç†å™¨ {} å¸è½½æˆåŠŸ", name);
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ Canaläº‹ä»¶å¤„ç†æœºåˆ¶æœ¬è´¨**
```
ğŸ”¸ äº‹ä»¶é©±åŠ¨æ¶æ„ï¼šé€šè¿‡äº‹ä»¶å®ç°ç³»ç»Ÿè§£è€¦å’Œæ•°æ®åŒæ­¥
ğŸ”¸ æµæ°´çº¿å¤„ç†ï¼šå¤šé˜¶æ®µå¹¶è¡Œå¤„ç†æé«˜ååé‡
ğŸ”¸ å¯æ‰©å±•è®¾è®¡ï¼šæ”¯æŒè‡ªå®šä¹‰å¤„ç†å™¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚
ğŸ”¸ é«˜å¯é æ€§ï¼šé€šè¿‡å­˜å‚¨ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†ä¿è¯æ•°æ®å®‰å…¨
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ äº‹ä»¶å¤„ç†çš„æ ¸å¿ƒä»·å€¼**
```
æ•°æ®åŒæ­¥ï¼š
â€¢ å®æ—¶æ€§ï¼šæ¯«ç§’çº§æ•°æ®åŒæ­¥
â€¢ å‡†ç¡®æ€§ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§
â€¢ é«˜æ•ˆæ€§ï¼šå¢é‡åŒæ­¥æ¯”å…¨é‡åŒæ­¥æ•ˆç‡é«˜ç™¾å€

ç³»ç»Ÿè§£è€¦ï¼š
â€¢ é™ä½å¤æ‚åº¦ï¼šç³»ç»Ÿé—´é€šè¿‡äº‹ä»¶é€šä¿¡
â€¢ æé«˜å¯ç»´æŠ¤æ€§ï¼šä¿®æ”¹ä¸€ä¸ªç³»ç»Ÿä¸å½±å“å…¶ä»–ç³»ç»Ÿ
â€¢ å¢å¼ºæ‰©å±•æ€§ï¼šæ–°å¢ç³»ç»Ÿåªéœ€è®¢é˜…ç›¸å…³äº‹ä»¶
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯**
```
å¹¶è¡Œå¤„ç†ï¼š
â€¢ æµæ°´çº¿ï¼šå¤šé˜¶æ®µå¹¶è¡Œæé«˜ååé‡
â€¢ åˆ†åŒºï¼šæŒ‰è¡¨æˆ–æŒ‰é”®åˆ†åŒºå¹¶è¡Œå¤„ç†
â€¢ æ‰¹é‡ï¼šæ‰¹é‡å¤„ç†å‡å°‘ç½‘ç»œå¼€é”€

å­˜å‚¨ä¼˜åŒ–ï¼š
â€¢ åˆ†å±‚ï¼šçƒ­æ¸©å†·æ•°æ®åˆ†å±‚å­˜å‚¨
â€¢ å‹ç¼©ï¼šåˆé€‚çš„å‹ç¼©ç®—æ³•èŠ‚çœç©ºé—´
â€¢ ç´¢å¼•ï¼šåˆç†ç´¢å¼•è®¾è®¡æå‡æŸ¥è¯¢æ€§èƒ½
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ å…¸å‹åº”ç”¨åœºæ™¯**
- **æ•°æ®åŒæ­¥**ï¼šä¸»ä»æ•°æ®åº“åŒæ­¥ã€ç¼“å­˜æ›´æ–°
- **äº‹ä»¶é©±åŠ¨**ï¼šå¾®æœåŠ¡é—´é€šè¿‡äº‹ä»¶é€šä¿¡
- **å®æ—¶è®¡ç®—**ï¼šå®æ—¶æ•°æ®åˆ†æã€ç›‘æ§å‘Šè­¦
- **å®¡è®¡æ—¥å¿—**ï¼šæ•°æ®å˜æ›´å®¡è®¡ã€åˆè§„è¦æ±‚

**ğŸ› ï¸ å·¥ç¨‹å®è·µè¦ç‚¹**
- **ç›‘æ§å‘Šè­¦**ï¼šå…³é”®æŒ‡æ ‡ç›‘æ§ï¼Œå¼‚å¸¸æƒ…å†µåŠæ—¶å‘Šè­¦
- **å®¹é”™è®¾è®¡**ï¼šå¤„ç†å¤±è´¥é‡è¯•ï¼Œé¿å…æ•°æ®ä¸¢å¤±
- **æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®ä¸šåŠ¡é‡è°ƒæ•´çº¿ç¨‹æ± å’Œç¼“å†²åŒºå¤§å°
- **è¿ç»´ç®¡ç†**ï¼šæä¾›ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒåŠ¨æ€é…ç½®ä¿®æ”¹

### 9.4 å­¦ä¹ è¿›é˜¶è·¯çº¿


**ğŸ“š æ·±å…¥å­¦ä¹ å»ºè®®**
```
åŸºç¡€æŒæ¡ â†’ åŸç†ç†è§£ â†’ å®è·µåº”ç”¨ â†’ æ€§èƒ½ä¼˜åŒ– â†’ æ¶æ„è®¾è®¡
    â†“          â†“          â†“          â†“          â†“
  ä¼šé…ç½®ä½¿ç”¨  æ‡‚å·¥ä½œåŸç†  èƒ½è§£å†³é—®é¢˜  èƒ½è°ƒä¼˜æ€§èƒ½  èƒ½è®¾è®¡æ–¹æ¡ˆ
```

**ğŸ¯ é‡ç‚¹å…³æ³¨é¢†åŸŸ**
- **binlogåŸç†**ï¼šæ·±å…¥ç†è§£MySQL binlogæœºåˆ¶
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šæŒæ¡Kafkaã€RocketMQç­‰æ¶ˆæ¯ä¸­é—´ä»¶
- **åˆ†å¸ƒå¼ç³»ç»Ÿ**ï¼šäº†è§£åˆ†å¸ƒå¼ä¸€è‡´æ€§ã€å®¹é”™ç­‰æ¦‚å¿µ
- **æ€§èƒ½è°ƒä¼˜**ï¼šæŒæ¡JVMè°ƒä¼˜ã€ç½‘ç»œä¼˜åŒ–ç­‰æŠ€èƒ½

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
- Canaläº‹ä»¶å¤„ç†æ˜¯æ•°æ®åŒæ­¥çš„æ ¸å¿ƒæœºåˆ¶
- æµæ°´çº¿è®¾è®¡å®ç°é«˜æ€§èƒ½å¹¶è¡Œå¤„ç†
- è‡ªå®šä¹‰å¤„ç†å™¨æ»¡è¶³ä¸ªæ€§åŒ–ä¸šåŠ¡éœ€æ±‚
- å­˜å‚¨ä¼˜åŒ–å’Œç›‘æ§æ˜¯ç”Ÿäº§ç¯å¢ƒå¿…éœ€
- ç†è§£åŸç†æ¯”è®°ä½é…ç½®æ›´é‡è¦