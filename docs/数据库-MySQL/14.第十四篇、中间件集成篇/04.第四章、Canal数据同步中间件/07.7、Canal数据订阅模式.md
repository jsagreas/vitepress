---
title: 7ã€Canalæ•°æ®è®¢é˜…æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [Canalæ•°æ®è®¢é˜…æ¨¡å¼æ¦‚è¿°](#1-Canalæ•°æ®è®¢é˜…æ¨¡å¼æ¦‚è¿°)
2. [æ¶ˆæ¯é˜Ÿåˆ—é›†æˆæœºåˆ¶](#2-æ¶ˆæ¯é˜Ÿåˆ—é›†æˆæœºåˆ¶)
3. [Kafkaæ¶ˆæ¯å‘å¸ƒå®ç°](#3-Kafkaæ¶ˆæ¯å‘å¸ƒå®ç°)
4. [RocketMQé›†æˆé…ç½®](#4-RocketMQé›†æˆé…ç½®)
5. [æ¶ˆæ¯æ ¼å¼ä¸åè®®](#5-æ¶ˆæ¯æ ¼å¼ä¸åè®®)
6. [è®¢é˜…è€…ç®¡ç†æœºåˆ¶](#6-è®¢é˜…è€…ç®¡ç†æœºåˆ¶)
7. [æ¶ˆæ¯å¯é æ€§ä¿è¯](#7-æ¶ˆæ¯å¯é æ€§ä¿è¯)
8. [æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ](#8-æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Canalæ•°æ®è®¢é˜…æ¨¡å¼æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Canalæ•°æ®è®¢é˜…æ¨¡å¼


**ç®€å•ç†è§£**ï¼šCanalæ•°æ®è®¢é˜…æ¨¡å¼å°±åƒæ˜¯ç»™æ•°æ®åº“å®‰è£…äº†ä¸€ä¸ª"ç›‘å¬å™¨"ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨æŠŠè¿™äº›å˜åŒ–æ¨é€ç»™éœ€è¦çš„ç³»ç»Ÿã€‚

```
ä¼ ç»Ÿæ•°æ®åŒæ­¥ï¼š
åº”ç”¨A â†’ ç›´æ¥æŸ¥è¯¢ â†’ æ•°æ®åº“ â† ç›´æ¥æŸ¥è¯¢ â†’ åº”ç”¨B
é—®é¢˜ï¼šé¢‘ç¹æŸ¥è¯¢ã€æ€§èƒ½å·®ã€å®æ—¶æ€§ä½

Canalè®¢é˜…æ¨¡å¼ï¼š
æ•°æ®åº“ â†’ Canalç›‘å¬ â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ è®¢é˜…è€…Aã€Bã€C...
ä¼˜åŠ¿ï¼šå®æ—¶æ¨é€ã€è§£è€¦ã€é«˜æ€§èƒ½
```

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
- **Canal**ï¼šé˜¿é‡Œå¼€æºçš„æ•°æ®åº“å˜æ›´æ•è·å·¥å…·
- **è®¢é˜…æ¨¡å¼**ï¼šå‘å¸ƒ-è®¢é˜…çš„æ¶ˆæ¯ä¼ é€’æ¨¡å¼
- **æ•°æ®å˜æ›´**ï¼šæ•°æ®åº“çš„å¢åˆ æ”¹æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰

### 1.2 Canalè®¢é˜…æ¨¡å¼çš„å·¥ä½œåŸç†


**å·¥ä½œæµç¨‹å›¾ç¤º**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL     â”‚â”€â”€â”€â–¶â”‚   Canal     â”‚â”€â”€â”€â–¶â”‚ æ¶ˆæ¯é˜Ÿåˆ—     â”‚â”€â”€â”€â–¶â”‚  è®¢é˜…è€…     â”‚
â”‚ (ä¸»åº“binlog) â”‚    â”‚ (è§£ææ¨é€)   â”‚    â”‚(Kafka/RMQ)  â”‚    â”‚(ä¸šåŠ¡åº”ç”¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯¦ç»†è§£é‡Š**ï¼š
1. **MySQLäº§ç”Ÿbinlog**ï¼šæ¯æ¬¡æ•°æ®å˜æ›´éƒ½ä¼šè®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­
2. **Canalè§£æbinlog**ï¼šCanalä¼ªè£…æˆMySQLçš„ä»åº“ï¼Œè·å–å¹¶è§£æbinlog
3. **æ¨é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå°†è§£æåçš„æ•°æ®å˜æ›´æ¨é€åˆ°Kafkaæˆ–RocketMQ
4. **è®¢é˜…è€…æ¶ˆè´¹æ¶ˆæ¯**ï¼šå„ä¸ªä¸šåŠ¡ç³»ç»Ÿè®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–æ•°æ®å˜æ›´

### 1.3 è®¢é˜…æ¨¡å¼çš„æ ¸å¿ƒä¼˜åŠ¿


**ğŸ”¸ å®æ—¶æ€§å¼º**
```
ç›´æ¥æŸ¥è¯¢æ–¹å¼ï¼šæ¯éš”5åˆ†é’ŸæŸ¥è¯¢ä¸€æ¬¡ â†’ æœ€å¤§å»¶è¿Ÿ5åˆ†é’Ÿ
Canalè®¢é˜…æ¨¡å¼ï¼šå˜æ›´å³æ¨é€ â†’ å»¶è¿Ÿé€šå¸¸åœ¨ç§’çº§
```

**ğŸ”¸ ç³»ç»Ÿè§£è€¦**
```
ä¼ ç»Ÿæ–¹å¼ï¼š
åº”ç”¨A â†â†’ æ•°æ®åº“ â†â†’ åº”ç”¨B
ä¿®æ”¹ä¸€ä¸ªå½±å“å¦ä¸€ä¸ª

è®¢é˜…æ¨¡å¼ï¼š
åº”ç”¨A â† æ¶ˆæ¯é˜Ÿåˆ— â†’ åº”ç”¨B
å½¼æ­¤ç‹¬ç«‹ï¼Œäº’ä¸å½±å“
```

**ğŸ”¸ æ‰©å±•æ€§å¥½**
```
æ–°å¢è®¢é˜…è€…ï¼šåªéœ€è¦è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—
æ— éœ€ä¿®æ”¹ï¼šç°æœ‰ç³»ç»Ÿæ— éœ€ä»»ä½•æ”¹åŠ¨
```

---

## 2. ğŸ“¨ æ¶ˆæ¯é˜Ÿåˆ—é›†æˆæœºåˆ¶


### 2.1 æ”¯æŒçš„æ¶ˆæ¯é˜Ÿåˆ—ç±»å‹


Canalç›®å‰æ”¯æŒå¤šç§æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ï¼š

| æ¶ˆæ¯é˜Ÿåˆ—ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **ä¼˜åŠ¿** | **æ³¨æ„äº‹é¡¹** |
|-------------|-------------|----------|-------------|
| **Kafka** | `å¤§æ•°æ®å¤„ç†ã€é«˜åå` | `æ€§èƒ½æé«˜ã€æŒä¹…åŒ–å¥½` | `é…ç½®ç›¸å¯¹å¤æ‚` |
| **RocketMQ** | `ä¼ä¸šçº§åº”ç”¨ã€äº‹åŠ¡æ¶ˆæ¯` | `åŠŸèƒ½ä¸°å¯Œã€å¯é æ€§é«˜` | `èµ„æºå ç”¨è¾ƒå¤š` |
| **Pulsar** | `äº‘åŸç”Ÿç¯å¢ƒ` | `å¤šç§Ÿæˆ·ã€å­˜å‚¨è®¡ç®—åˆ†ç¦»` | `ç›¸å¯¹è¾ƒæ–°` |
| **RabbitMQ** | `ä¸­å°å‹é¡¹ç›®` | `ç®€å•æ˜“ç”¨ã€ç®¡ç†ç•Œé¢å‹å¥½` | `æ€§èƒ½ä¸€èˆ¬` |

### 2.2 æ¶ˆæ¯é˜Ÿåˆ—é›†æˆæ¶æ„


**æ•´ä½“æ¶æ„å›¾**ï¼š
```
                   Canal Server
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚          â”‚          â”‚
         Kafka      RocketMQ   Pulsar
            â”‚          â”‚          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚è®¢é˜…è€…Aâ”‚Bâ”‚  â”‚è®¢é˜…è€…Câ”‚  â”‚è®¢é˜…è€…Dâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é›†æˆæ–¹å¼è¯´æ˜**ï¼š
- **Serveræ¨¡å¼**ï¼šCanal Serverç›´æ¥æ¨é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—
- **Clientæ¨¡å¼**ï¼šåº”ç”¨ç¨‹åºé€šè¿‡Canal Clientè·å–æ•°æ®åæ¨é€
- **Adapteræ¨¡å¼**ï¼šä½¿ç”¨Canal Adapterè¿›è¡Œæ•°æ®æ ¼å¼è½¬æ¢

### 2.3 æ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©å»ºè®®


**ğŸ¯ é€‰æ‹©ä¾æ®**ï¼š

**é€‰æ‹©Kafkaçš„æƒ…å†µ**ï¼š
```
âœ… æ•°æ®é‡å¤§ï¼šæ—¥å¤„ç†ç™¾ä¸‡çº§ä»¥ä¸Šå˜æ›´
âœ… å®æ—¶æ€§è¦æ±‚é«˜ï¼šæ¯«ç§’çº§å»¶è¿Ÿ
âœ… å·²æœ‰Kafkaç¯å¢ƒï¼šå‡å°‘ç»´æŠ¤æˆæœ¬
âœ… å¤§æ•°æ®åœºæ™¯ï¼šé…åˆSparkã€Flinkä½¿ç”¨
```

**é€‰æ‹©RocketMQçš„æƒ…å†µ**ï¼š
```
âœ… ä¼ä¸šçº§åº”ç”¨ï¼šéœ€è¦é«˜å¯é æ€§
âœ… äº‹åŠ¡æ”¯æŒï¼šéœ€è¦æ¶ˆæ¯äº‹åŠ¡åŠŸèƒ½
âœ… è¿ç»´ç®€å•ï¼šå¸Œæœ›ç®¡ç†ç•Œé¢å‹å¥½
âœ… é˜¿é‡Œç”Ÿæ€ï¼šå·²ä½¿ç”¨é˜¿é‡Œäº‘æœåŠ¡
```

---

## 3. ğŸ”§ Kafkaæ¶ˆæ¯å‘å¸ƒå®ç°


### 3.1 Canal Kafka Connectoré…ç½®


**åŸºç¡€é…ç½®æ–‡ä»¶** `canal.properties`ï¼š
```properties
# CanalåŸºç¡€é…ç½®
canal.id = 1
canal.ip = 127.0.0.1
canal.port = 11111
canal.serverMode = kafka

# Kafkaè¿æ¥é…ç½®
kafka.bootstrap.servers = localhost:9092
kafka.retries = 3
kafka.batch.size = 16384
kafka.linger.ms = 1
kafka.buffer.memory = 33554432

# æ¶ˆæ¯å‘é€é…ç½®
kafka.acks = all
kafka.compression.type = gzip
```

**å®ä¾‹é…ç½®æ–‡ä»¶** `instance.properties`ï¼š
```properties
# æ•°æ®åº“è¿æ¥
canal.instance.master.address = 127.0.0.1:3306
canal.instance.dbUsername = canal
canal.instance.dbPassword = canal123

# Kafka Topicé…ç½®
canal.mq.topic = canal_test
canal.mq.partition = 0

# æ¶ˆæ¯æ ¼å¼
canal.mq.flatMessage = true
```

### 3.2 Kafkaæ¶ˆæ¯å‘å¸ƒæµç¨‹


**å‘å¸ƒæµç¨‹å›¾**ï¼š
```
MySQLå˜æ›´ â†’ Canalè§£æ â†’ æ¶ˆæ¯æ„å»º â†’ Kafkaå‘é€
    â”‚           â”‚           â”‚           â”‚
    â”‚           â”‚           â”‚           â””â”€ åˆ†åŒºç­–ç•¥
    â”‚           â”‚           â””â”€ æ¶ˆæ¯æ ¼å¼åŒ–
    â”‚           â””â”€ binlogè§£æ
    â””â”€ INSERT/UPDATE/DELETE
```

**æ¶ˆæ¯å‘é€ä»£ç ç¤ºä¾‹**ï¼š
```java
// Canal Kafka Produceræ ¸å¿ƒé€»è¾‘
public class CanalKafkaProducer {
    private KafkaProducer<String, String> producer;
    
    public void sendMessage(CanalEntry.Entry entry) {
        // 1. æ„å»ºæ¶ˆæ¯
        FlatMessage flatMessage = buildFlatMessage(entry);
        String message = JSON.toJSONString(flatMessage);
        
        // 2. ç¡®å®šTopicå’Œåˆ†åŒº
        String topic = "canal_" + entry.getHeader().getSchemaName();
        String key = entry.getHeader().getTableName();
        
        // 3. å‘é€æ¶ˆæ¯
        ProducerRecord<String, String> record = 
            new ProducerRecord<>(topic, key, message);
        
        producer.send(record, new Callback() {
            @Override
            public void onCompletion(RecordMetadata metadata, Exception e) {
                if (e != null) {
                    logger.error("å‘é€å¤±è´¥", e);
                } else {
                    logger.info("å‘é€æˆåŠŸï¼Œoffset: " + metadata.offset());
                }
            }
        });
    }
}
```

### 3.3 Kafkaåˆ†åŒºç­–ç•¥


**åˆ†åŒºç­–ç•¥é€‰æ‹©**ï¼š

```java
// æŒ‰è¡¨ååˆ†åŒº
public class TablePartitioner implements Partitioner {
    @Override
    public int partition(String topic, Object key, byte[] keyBytes,
                        Object value, byte[] valueBytes, Cluster cluster) {
        String tableName = (String) key;
        return Math.abs(tableName.hashCode()) % 
               cluster.partitionCountForTopic(topic);
    }
}
```

**åˆ†åŒºç­–ç•¥å¯¹æ¯”**ï¼š
- **é»˜è®¤åˆ†åŒº**ï¼šè½®è¯¢åˆ†é…ï¼Œè´Ÿè½½å‡è¡¡å¥½
- **æŒ‰è¡¨åˆ†åŒº**ï¼šåŒè¡¨æ•°æ®é¡ºåºæ€§å¥½
- **æŒ‰ä¸»é”®åˆ†åŒº**ï¼šåŒè®°å½•å˜æ›´é¡ºåºæ€§æœ€ä½³

---

## 4. ğŸš€ RocketMQé›†æˆé…ç½®


### 4.1 Canal RocketMQ Produceré…ç½®


**RocketMQè¿æ¥é…ç½®**ï¼š
```properties
# RocketMQåŸºç¡€é…ç½®
rocketmq.nameserver.address = 127.0.0.1:9876
rocketmq.producer.group = canal_producer
rocketmq.enable.message.trace = true

# æ¶ˆæ¯é…ç½®
rocketmq.producer.send.msg.timeout = 3000
rocketmq.producer.retry.times.when.send.failed = 2
rocketmq.producer.max.message.size = 4194304
```

**å®ä¾‹é…ç½®**ï¼š
```properties
# Canalå®ä¾‹é…ç½®
canal.instance.master.address = 127.0.0.1:3306
canal.instance.dbUsername = canal
canal.instance.dbPassword = canal123

# RocketMQ Topicé…ç½®
canal.mq.topic = canal_rocketmq_topic
canal.mq.tag = 
```

### 4.2 RocketMQæ¶ˆæ¯å‘é€å®ç°


**å‘é€é€»è¾‘ä»£ç **ï¼š
```java
public class CanalRocketMQProducer {
    private DefaultMQProducer producer;
    
    public void sendMessage(List<CanalEntry.Entry> entries) {
        for (CanalEntry.Entry entry : entries) {
            try {
                // æ„å»ºæ¶ˆæ¯
                Message message = buildMessage(entry);
                
                // å‘é€æ¶ˆæ¯
                SendResult result = producer.send(message);
                
                if (result.getSendStatus() == SendStatus.SEND_OK) {
                    logger.info("RocketMQå‘é€æˆåŠŸ: " + result.getMsgId());
                }
            } catch (Exception e) {
                logger.error("RocketMQå‘é€å¤±è´¥", e);
            }
        }
    }
    
    private Message buildMessage(CanalEntry.Entry entry) {
        String topic = "canal_" + entry.getHeader().getSchemaName();
        String tag = entry.getHeader().getTableName();
        
        FlatMessage flatMessage = MessageUtils.buildFlatMessage(entry);
        byte[] body = JSON.toJSONBytes(flatMessage);
        
        Message message = new Message(topic, tag, body);
        
        // è®¾ç½®æ¶ˆæ¯å±æ€§
        message.putUserProperty("database", entry.getHeader().getSchemaName());
        message.putUserProperty("table", entry.getHeader().getTableName());
        
        return message;
    }
}
```

### 4.3 RocketMQé«˜çº§ç‰¹æ€§


**ğŸ”¸ æ¶ˆæ¯TAGä½¿ç”¨**ï¼š
```java
// æŒ‰æ•°æ®åº“æ“ä½œç±»å‹è®¾ç½®TAG
String tag = entry.getHeader().getEventType().name(); // INSERT/UPDATE/DELETE

// è®¢é˜…è€…å¯ä»¥æŒ‰TAGè¿‡æ»¤
consumer.subscribe("canal_topic", "INSERT || UPDATE");
```

**ğŸ”¸ å»¶è¿Ÿæ¶ˆæ¯**ï¼š
```java
// å»¶è¿Ÿå¤„ç†æŸäº›å˜æ›´
if (isNeedDelay(entry)) {
    message.setDelayTimeLevel(3); // å»¶è¿Ÿ10ç§’
}
```

**ğŸ”¸ æ¶ˆæ¯è½¨è¿¹**ï¼š
```properties
# å¼€å¯æ¶ˆæ¯è½¨è¿¹ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
rocketmq.enable.message.trace = true
rocketmq.trace.topic = RMQ_SYS_TRACE_TOPIC
```

---

## 5. ğŸ“‹ æ¶ˆæ¯æ ¼å¼ä¸åè®®


### 5.1 Canalæ¶ˆæ¯æ ¼å¼åè®®


Canalæä¾›äº†ä¸¤ç§ä¸»è¦çš„æ¶ˆæ¯æ ¼å¼ï¼š

**ğŸ”¸ åŸå§‹æ ¼å¼ï¼ˆProtobufï¼‰**ï¼š
```protobuf
message Entry {
    Header header = 1;
    EntryType entryType = 2;
    bytes storeValue = 3;
}

message Header {
    int64 logfileName = 1;
    int64 logfileOffset = 2;
    int64 executeTime = 3;
    string schemaName = 4;
    string tableName = 5;
    EventType eventType = 6;
}
```

**ğŸ”¸ æ‰å¹³æ ¼å¼ï¼ˆJSONï¼‰**ï¼š
```json
{
    "id": 1,
    "database": "test",
    "table": "user",
    "pkNames": ["id"],
    "isDdl": false,
    "type": "UPDATE",
    "es": 1589442695000,
    "ts": 1589442696264,
    "sql": "",
    "data": [
        {
            "id": "1",
            "name": "å¼ ä¸‰",
            "age": "25"
        }
    ],
    "old": [
        {
            "name": "æå››",
            "age": "24"
        }
    ]
}
```

### 5.2 æ¶ˆæ¯æ ¼å¼é…ç½®


**é€‰æ‹©æ‰å¹³æ ¼å¼**ï¼š
```properties
# ä½¿ç”¨æ‰å¹³æ ¼å¼ï¼Œä¾¿äºä¸šåŠ¡å¤„ç†
canal.mq.flatMessage = true

# æ¶ˆæ¯å†…å®¹åŒ…å«SQLè¯­å¥
canal.mq.send.thread.size = 30
canal.mq.build.thread.size = 8
```

**æ¶ˆæ¯æ ¼å¼å¤„ç†ä»£ç **ï¼š
```java
public class MessageParser {
    
    // è§£ææ‰å¹³æ ¼å¼æ¶ˆæ¯
    public void parseFlatMessage(String message) {
        FlatMessage flatMessage = JSON.parseObject(message, FlatMessage.class);
        
        String operation = flatMessage.getType(); // INSERT/UPDATE/DELETE
        String database = flatMessage.getDatabase();
        String table = flatMessage.getTable();
        
        // å¤„ç†æ•°æ®å˜æ›´
        List<Map<String, String>> data = flatMessage.getData();
        for (Map<String, String> row : data) {
            processRowData(operation, database, table, row);
        }
    }
    
    // å¤„ç†å•è¡Œæ•°æ®
    private void processRowData(String operation, String db, 
                               String table, Map<String, String> row) {
        switch (operation) {
            case "INSERT":
                handleInsert(db, table, row);
                break;
            case "UPDATE":
                handleUpdate(db, table, row);
                break;
            case "DELETE":
                handleDelete(db, table, row);
                break;
        }
    }
}
```

### 5.3 è‡ªå®šä¹‰æ¶ˆæ¯æ ¼å¼


**è‡ªå®šä¹‰æ ¼å¼è½¬æ¢**ï¼š
```java
public class CustomMessageBuilder {
    
    public String buildCustomMessage(CanalEntry.Entry entry) {
        CustomMessage customMsg = new CustomMessage();
        
        // è®¾ç½®åŸºç¡€ä¿¡æ¯
        customMsg.setTimestamp(System.currentTimeMillis());
        customMsg.setDatabase(entry.getHeader().getSchemaName());
        customMsg.setTable(entry.getHeader().getTableName());
        customMsg.setOperation(entry.getHeader().getEventType().name());
        
        // è§£ææ•°æ®å˜æ›´
        if (entry.getEntryType() == CanalEntry.EntryType.ROWDATA) {
            CanalEntry.RowChange rowChange = 
                CanalEntry.RowChange.parseFrom(entry.getStoreValue());
            
            for (CanalEntry.RowData rowData : rowChange.getRowDatasList()) {
                // æ„å»ºè‡ªå®šä¹‰æ•°æ®æ ¼å¼
                buildCustomRowData(customMsg, rowData);
            }
        }
        
        return JSON.toJSONString(customMsg);
    }
}
```

---

## 6. ğŸ‘¥ è®¢é˜…è€…ç®¡ç†æœºåˆ¶


### 6.1 è®¢é˜…è€…å®¢æˆ·ç«¯SDK


**Kafkaè®¢é˜…è€…å®ç°**ï¼š
```java
@Component
public class CanalKafkaConsumer {
    
    @Value("${kafka.bootstrap.servers}")
    private String servers;
    
    @Value("${kafka.topic}")
    private String topic;
    
    private KafkaConsumer<String, String> consumer;
    
    @PostConstruct
    public void init() {
        Properties props = new Properties();
        props.put("bootstrap.servers", servers);
        props.put("group.id", "canal_consumer_group");
        props.put("enable.auto.commit", "false"); // æ‰‹åŠ¨æäº¤
        props.put("key.deserializer", StringDeserializer.class);
        props.put("value.deserializer", StringDeserializer.class);
        
        consumer = new KafkaConsumer<>(props);
        consumer.subscribe(Arrays.asList(topic));
    }
    
    @EventListener
    public void consume() {
        while (true) {
            ConsumerRecords<String, String> records = 
                consumer.poll(Duration.ofMillis(1000));
            
            for (ConsumerRecord<String, String> record : records) {
                try {
                    // å¤„ç†æ¶ˆæ¯
                    processMessage(record.value());
                    
                    // æ‰‹åŠ¨æäº¤offset
                    consumer.commitSync();
                } catch (Exception e) {
                    logger.error("å¤„ç†æ¶ˆæ¯å¤±è´¥", e);
                }
            }
        }
    }
}
```

**RocketMQè®¢é˜…è€…å®ç°**ï¼š
```java
@Component
public class CanalRocketMQConsumer {
    
    @PostConstruct
    public void init() throws MQClientException {
        DefaultMQPushConsumer consumer = new DefaultMQPushConsumer();
        consumer.setConsumerGroup("canal_consumer_group");
        consumer.setNamesrvAddr("127.0.0.1:9876");
        
        // è®¢é˜…Topic
        consumer.subscribe("canal_topic", "*");
        
        // æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨
        consumer.registerMessageListener(new MessageListenerConcurrently() {
            @Override
            public ConsumeConcurrentlyStatus consumeMessage(
                    List<MessageExt> messages,
                    ConsumeConcurrentlyContext context) {
                
                for (MessageExt message : messages) {
                    try {
                        String content = new String(message.getBody());
                        processMessage(content);
                    } catch (Exception e) {
                        logger.error("å¤„ç†æ¶ˆæ¯å¤±è´¥", e);
                        return ConsumeConcurrentlyStatus.RECONSUME_LATER;
                    }
                }
                
                return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
            }
        });
        
        consumer.start();
    }
}
```

### 6.2 è®¢é˜…è€…è´Ÿè½½å‡è¡¡ç­–ç•¥


**Kafkaåˆ†åŒºåˆ†é…**ï¼š
```
Topic: canal_test (3ä¸ªåˆ†åŒº)
æ¶ˆè´¹è€…ç»„: canal_group (2ä¸ªæ¶ˆè´¹è€…)

åˆ†é…ç»“æœï¼š
æ¶ˆè´¹è€…1ï¼šåˆ†åŒº0ã€åˆ†åŒº1
æ¶ˆè´¹è€…2ï¼šåˆ†åŒº2

æ–°å¢æ¶ˆè´¹è€…3åé‡æ–°åˆ†é…ï¼š
æ¶ˆè´¹è€…1ï¼šåˆ†åŒº0
æ¶ˆè´¹è€…2ï¼šåˆ†åŒº1  
æ¶ˆè´¹è€…3ï¼šåˆ†åŒº2
```

**RocketMQé˜Ÿåˆ—åˆ†é…**ï¼š
```java
// è‡ªå®šä¹‰é˜Ÿåˆ—åˆ†é…ç­–ç•¥
public class CustomAllocateMessageQueueStrategy 
    implements AllocateMessageQueueStrategy {
    
    @Override
    public List<MessageQueue> allocate(String consumerGroup,
                                      String currentCID,
                                      List<MessageQueue> mqAll,
                                      List<String> cidAll) {
        // å®ç°è‡ªå®šä¹‰åˆ†é…é€»è¾‘
        // ä¾‹å¦‚ï¼šæŒ‰æ¶ˆè´¹è€…èƒ½åŠ›åˆ†é…
        return allocateByCapacity(currentCID, mqAll, cidAll);
    }
}
```

### 6.3 è®¢é˜…è€…ç›‘æ§ç®¡ç†


**æ¶ˆè´¹è¿›åº¦ç›‘æ§**ï¼š
```java
@RestController
public class ConsumerMonitorController {
    
    @Autowired
    private CanalConsumerMetrics metrics;
    
    @GetMapping("/consumer/status")
    public Map<String, Object> getConsumerStatus() {
        Map<String, Object> status = new HashMap<>();
        
        // Kafkaæ¶ˆè´¹è¿›åº¦
        status.put("kafkaLag", metrics.getKafkaConsumerLag());
        
        // RocketMQæ¶ˆè´¹è¿›åº¦
        status.put("rocketmqLag", metrics.getRocketMQConsumerLag());
        
        // æ¶ˆè´¹é€Ÿåº¦
        status.put("consumeRate", metrics.getConsumeRate());
        
        return status;
    }
}
```

---

## 7. ğŸ›¡ï¸ æ¶ˆæ¯å¯é æ€§ä¿è¯


### 7.1 æ¶ˆæ¯ç¡®è®¤æœºåˆ¶


**Kafkaæ¶ˆæ¯ç¡®è®¤**ï¼š
```java
public class ReliableKafkaConsumer {
    
    public void processWithAck() {
        while (true) {
            ConsumerRecords<String, String> records = consumer.poll(1000);
            
            for (ConsumerRecord<String, String> record : records) {
                try {
                    // ä¸šåŠ¡å¤„ç†
                    boolean success = processBusinessLogic(record.value());
                    
                    if (success) {
                        // åªæœ‰ä¸šåŠ¡å¤„ç†æˆåŠŸæ‰æäº¤offset
                        consumer.commitSync();
                        logger.info("æ¶ˆæ¯å¤„ç†æˆåŠŸï¼Œoffset: " + record.offset());
                    } else {
                        // ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼Œä¸æäº¤offsetï¼Œä¸‹æ¬¡é‡æ–°æ¶ˆè´¹
                        logger.warn("ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼Œå°†é‡æ–°æ¶ˆè´¹");
                        break;
                    }
                } catch (Exception e) {
                    logger.error("æ¶ˆæ¯å¤„ç†å¼‚å¸¸", e);
                    // å¼‚å¸¸æ—¶ä¹Ÿä¸æäº¤offset
                    break;
                }
            }
        }
    }
}
```

**RocketMQæ¶ˆæ¯ç¡®è®¤**ï¼š
```java
public MessageListenerConcurrently createReliableListener() {
    return new MessageListenerConcurrently() {
        @Override
        public ConsumeConcurrentlyStatus consumeMessage(
                List<MessageExt> messages,
                ConsumeConcurrentlyContext context) {
            
            for (MessageExt message : messages) {
                try {
                    boolean success = processMessage(message);
                    
                    if (!success) {
                        // è¿”å›RECONSUME_LATERï¼Œæ¶ˆæ¯ä¼šé‡æ–°æŠ•é€’
                        return ConsumeConcurrentlyStatus.RECONSUME_LATER;
                    }
                } catch (Exception e) {
                    logger.error("æ¶ˆæ¯å¤„ç†å¤±è´¥", e);
                    return ConsumeConcurrentlyStatus.RECONSUME_LATER;
                }
            }
            
            return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
        }
    };
}
```

### 7.2 é‡å¤æ¶ˆæ¯å¤„ç†ï¼ˆå¹‚ç­‰æ€§ä¿è¯ï¼‰


**å¹‚ç­‰æ€§å®ç°æ–¹æ¡ˆ**ï¼š

**ğŸ”¸ ä¸šåŠ¡ä¸»é”®å¹‚ç­‰**ï¼š
```java
@Service
public class IdempotentProcessor {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public boolean processMessage(String messageId, String content) {
        // 1. æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦å·²å¤„ç†
        String key = "processed_msg:" + messageId;
        if (redisTemplate.hasKey(key)) {
            logger.info("æ¶ˆæ¯å·²å¤„ç†ï¼Œè·³è¿‡: " + messageId);
            return true;
        }
        
        try {
            // 2. å¤„ç†ä¸šåŠ¡é€»è¾‘
            processBusinessLogic(content);
            
            // 3. æ ‡è®°æ¶ˆæ¯å·²å¤„ç†ï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰
            redisTemplate.opsForValue().set(key, "1", 
                Duration.ofHours(24));
            
            return true;
        } catch (Exception e) {
            logger.error("ä¸šåŠ¡å¤„ç†å¤±è´¥", e);
            return false;
        }
    }
}
```

**ğŸ”¸ æ•°æ®åº“å”¯ä¸€ç´¢å¼•å¹‚ç­‰**ï¼š
```sql
-- åˆ›å»ºå¤„ç†è®°å½•è¡¨
CREATE TABLE message_process_log (
    message_id VARCHAR(64) PRIMARY KEY,
    process_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status TINYINT DEFAULT 1
);

-- ä¸šåŠ¡å¤„ç†æ—¶å…ˆæ’å…¥è®°å½•
INSERT IGNORE INTO message_process_log(message_id) VALUES(?);
```

### 7.3 æ¶ˆæ¯é¡ºåºæ€§å¤„ç†


**é¡ºåºæ¶ˆæ¯ä¿è¯**ï¼š

**Kafkaé¡ºåºæ€§**ï¼š
```java
// ç”Ÿäº§è€…ï¼šç›¸åŒkeyçš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€åˆ†åŒº
ProducerRecord<String, String> record = 
    new ProducerRecord<>(topic, tableKey, message);

// æ¶ˆè´¹è€…ï¼šå•åˆ†åŒºå†…æ¶ˆæ¯æœ‰åº
@KafkaListener(topics = "canal_topic", 
               containerFactory = "kafkaListenerContainerFactory")
public void consumeInOrder(String message) {
    // å•çº¿ç¨‹å¤„ç†ä¿è¯é¡ºåº
    processMessageInOrder(message);
}
```

**RocketMQé¡ºåºæ€§**ï¼š
```java
// å‘é€é¡ºåºæ¶ˆæ¯
Message msg = new Message("canal_topic", "tag", content.getBytes());
SendResult result = producer.send(msg, new MessageQueueSelector() {
    @Override
    public MessageQueue select(List<MessageQueue> mqs, 
                              Message msg, Object arg) {
        // æŒ‰è¡¨åé€‰æ‹©é˜Ÿåˆ—ï¼ŒåŒè¡¨æ¶ˆæ¯è¿›å…¥åŒä¸€é˜Ÿåˆ—
        String tableName = (String) arg;
        int index = Math.abs(tableName.hashCode()) % mqs.size();
        return mqs.get(index);
    }
}, tableName);

// æ¶ˆè´¹é¡ºåºæ¶ˆæ¯
consumer.registerMessageListener(new MessageListenerOrderly() {
    @Override
    public ConsumeOrderlyStatus consumeMessage(
            List<MessageExt> messages,
            ConsumeOrderlyContext context) {
        // é¡ºåºæ¶ˆè´¹é€»è¾‘
        return ConsumeOrderlyStatus.SUCCESS;
    }
});
```

### 7.4 æ¶ˆæ¯é˜Ÿåˆ—æ•…éšœå¤„ç†


**æ•…éšœå¤„ç†ç­–ç•¥**ï¼š

```java
@Component
public class MQFailoverHandler {
    
    @Autowired
    private KafkaTemplate<String, String> kafkaTemplate;
    
    @Autowired
    private RocketMQTemplate rocketMQTemplate;
    
    // åŒå†™ç­–ç•¥ï¼šåŒæ—¶å†™å…¥ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—
    public void sendWithFailover(String message) {
        try {
            // ä¸»ï¼šKafka
            kafkaTemplate.send("canal_topic", message);
        } catch (Exception e) {
            logger.warn("Kafkaå‘é€å¤±è´¥ï¼Œåˆ‡æ¢åˆ°RocketMQ", e);
            try {
                // å¤‡ï¼šRocketMQ
                rocketMQTemplate.convertAndSend("canal_topic", message);
            } catch (Exception ex) {
                logger.error("æ‰€æœ‰MQéƒ½å‘é€å¤±è´¥", ex);
                // å†™å…¥æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“
                saveToLocal(message);
            }
        }
    }
    
    // æœ¬åœ°å­˜å‚¨å…œåº•
    private void saveToLocal(String message) {
        // å†™å…¥æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ï¼Œåç»­è¡¥å¿å¤„ç†
    }
}
```

---

## 8. âš¡ æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ


### 8.1 æ¶ˆæ¯é˜Ÿåˆ—æ€§èƒ½ä¼˜åŒ–


**Kafkaæ€§èƒ½ä¼˜åŒ–**ï¼š
```properties
# ç”Ÿäº§è€…ä¼˜åŒ–
batch.size = 32768                    # æ‰¹æ¬¡å¤§å°
linger.ms = 10                        # ç­‰å¾…æ—¶é—´
compression.type = lz4                # å‹ç¼©ç®—æ³•
acks = 1                             # ç¡®è®¤çº§åˆ«

# æ¶ˆè´¹è€…ä¼˜åŒ–  
fetch.min.bytes = 1048576            # æœ€å°æ‹‰å–å­—èŠ‚
fetch.max.wait.ms = 500              # æœ€å¤§ç­‰å¾…æ—¶é—´
max.poll.records = 1000              # å•æ¬¡æ‹‰å–è®°å½•æ•°
```

**RocketMQæ€§èƒ½ä¼˜åŒ–**ï¼š
```properties
# ç”Ÿäº§è€…ä¼˜åŒ–
rocketmq.producer.send.msg.timeout = 3000
rocketmq.producer.compress.msg.body.over.howmuch = 4096
rocketmq.producer.max.message.size = 4194304

# æ¶ˆè´¹è€…ä¼˜åŒ–
rocketmq.consumer.consume.thread.min = 20
rocketmq.consumer.consume.thread.max = 64
rocketmq.consumer.consume.message.batch.max.size = 32
```

### 8.2 Canalé…ç½®ä¼˜åŒ–


**æ ¸å¿ƒå‚æ•°è°ƒä¼˜**ï¼š
```properties
# å†…å­˜é…ç½®
canal.instance.memory.buffer.size = 32768
canal.instance.memory.buffer.memunit = 1024

# ç½‘ç»œé…ç½®
canal.instance.network.receiveBufferSize = 16384
canal.instance.network.sendBufferSize = 16384

# æ‰¹å¤„ç†é…ç½®
canal.instance.get.ddl.isolation = true
canal.mq.send.thread.size = 30
canal.mq.build.thread.size = 8
```

### 8.3 è®¢é˜…æ¨¡å¼æœ€ä½³å®è·µ


**ğŸ¯ æ¶æ„è®¾è®¡æœ€ä½³å®è·µ**ï¼š

```
æœ€ä½³å®è·µæ¶æ„ï¼š

                     â”Œâ”€ Kafka Cluster â”€â”
MySQL â†’ Canal â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”œâ”€ è®¢é˜…è€…Aï¼ˆå®æ—¶è®¡ç®—ï¼‰
                     â”‚   3ä¸ªBroker     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                     â”Œâ”€ RocketMQ â”€â”
                     â”‚            â”œâ”€ è®¢é˜…è€…Bï¼ˆä¸šåŠ¡å¤„ç†ï¼‰
                     â”‚ 2ä¸ªBroker  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†ç¦»ç­–ç•¥**ï¼š
- **å®æ—¶è®¡ç®—**ï¼šä½¿ç”¨Kafkaï¼Œè¿½æ±‚é«˜åå
- **ä¸šåŠ¡å¤„ç†**ï¼šä½¿ç”¨RocketMQï¼Œè¿½æ±‚å¯é æ€§
- **ç›‘æ§å‘Šè­¦**ï¼šå•ç‹¬topicï¼Œä½å»¶è¿Ÿæ¨é€

**ğŸ”¸ æ¶ˆæ¯è¿‡æ»¤ç­–ç•¥**ï¼š
```java
// åœ¨Canalç«¯è¿‡æ»¤ï¼Œå‡å°‘æ— æ•ˆæ¶ˆæ¯
canal.instance.filter.regex = .*\\.(user|order|product)

// åœ¨è®¢é˜…è€…ç«¯è¿‡æ»¤ï¼Œç»†ç²’åº¦æ§åˆ¶
@RocketMQMessageListener(
    topic = "canal_topic",
    selectorExpression = "INSERT || UPDATE"  // åªå¤„ç†å¢æ”¹
)
public class BusinessMessageListener {
    // å¤„ç†é€»è¾‘
}
```

**ğŸ”¸ ç›‘æ§å‘Šè­¦æœºåˆ¶**ï¼š
```java
@Component
public class CanalMonitor {
    
    @Scheduled(fixedRate = 30000) // 30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void checkHealth() {
        // æ£€æŸ¥Canalå»¶è¿Ÿ
        long delay = getCanalDelay();
        if (delay > 10000) { // è¶…è¿‡10ç§’
            alertManager.sendAlert("Canalå»¶è¿Ÿå‘Šè­¦: " + delay + "ms");
        }
        
        // æ£€æŸ¥æ¶ˆè´¹ç§¯å‹
        long lag = getConsumerLag();
        if (lag > 1000) { // è¶…è¿‡1000æ¡
            alertManager.sendAlert("æ¶ˆæ¯ç§¯å‹å‘Šè­¦: " + lag + "æ¡");
        }
    }
}
```

### 8.4 å®¹é‡è§„åˆ’å»ºè®®


**å®¹é‡è¯„ä¼°å…¬å¼**ï¼š
```
æ—¥æ¶ˆæ¯é‡ = æ—¥æ•°æ®å˜æ›´æ¬¡æ•° Ã— å¹³å‡æ¶ˆæ¯å¤§å°
æ‰€éœ€å¸¦å®½ = æ—¥æ¶ˆæ¯é‡ / (24 Ã— 3600) Ã— å³°å€¼å€æ•°
å­˜å‚¨ç©ºé—´ = æ—¥æ¶ˆæ¯é‡ Ã— ä¿ç•™å¤©æ•°
```

**å®é™…æ¡ˆä¾‹**ï¼š
```
å‡è®¾ï¼š
- æ—¥æ•°æ®å˜æ›´ï¼š100ä¸‡æ¬¡
- å¹³å‡æ¶ˆæ¯å¤§å°ï¼š2KB  
- å³°å€¼å€æ•°ï¼š5å€
- ä¿ç•™å¤©æ•°ï¼š7å¤©

è®¡ç®—ç»“æœï¼š
- æ—¥æ¶ˆæ¯é‡ï¼š100ä¸‡ Ã— 2KB = 2GB
- æ‰€éœ€å¸¦å®½ï¼š2GB/(24Ã—3600) Ã— 5 = 115KB/s
- å­˜å‚¨ç©ºé—´ï¼š2GB Ã— 7å¤© = 14GB
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Canalè®¢é˜…æ¨¡å¼ï¼šå®æ—¶æ•°æ®å˜æ›´æ¨é€çš„è§£å†³æ–¹æ¡ˆ
ğŸ”¸ æ¶ˆæ¯é˜Ÿåˆ—é›†æˆï¼šKafkaé«˜æ€§èƒ½ã€RocketMQé«˜å¯é 
ğŸ”¸ æ¶ˆæ¯æ ¼å¼åè®®ï¼šæ‰å¹³æ ¼å¼ä¾¿äºä¸šåŠ¡å¤„ç†
ğŸ”¸ è®¢é˜…è€…ç®¡ç†ï¼šè´Ÿè½½å‡è¡¡ã€ç›‘æ§å‘Šè­¦æœºåˆ¶
ğŸ”¸ å¯é æ€§ä¿è¯ï¼šæ¶ˆæ¯ç¡®è®¤ã€å¹‚ç­‰å¤„ç†ã€é¡ºåºä¿è¯
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šå‚æ•°è°ƒä¼˜ã€æ¶æ„è®¾è®¡ã€å®¹é‡è§„åˆ’
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆé€‰æ‹©è®¢é˜…æ¨¡å¼**
```
ä¼ ç»Ÿè½®è¯¢æ–¹å¼ï¼š
âŒ å»¶è¿Ÿé«˜ï¼šå®šæ—¶æŸ¥è¯¢ï¼Œæœ€å¤§å»¶è¿Ÿ=æŸ¥è¯¢é—´éš”
âŒ æ€§èƒ½å·®ï¼šé¢‘ç¹æŸ¥è¯¢æ•°æ®åº“ï¼Œèµ„æºæµªè´¹
âŒ è€¦åˆç´§ï¼šåº”ç”¨ç›´æ¥ä¾èµ–æ•°æ®åº“

Canalè®¢é˜…æ¨¡å¼ï¼š
âœ… å®æ—¶æ€§ï¼šå˜æ›´å³æ¨é€ï¼Œç§’çº§å»¶è¿Ÿ
âœ… é«˜æ€§èƒ½ï¼šåŸºäºbinlogï¼Œå¯¹æ•°æ®åº“å½±å“å°
âœ… è§£è€¦å¥½ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç³»ç»Ÿç‹¬ç«‹
```

**ğŸ”¹ æ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©åŸåˆ™**
```
é€‰æ‹©Kafkaçš„åœºæ™¯ï¼š
â€¢ æ•°æ®é‡å¤§ï¼šæ—¥ç™¾ä¸‡çº§ä»¥ä¸Šå˜æ›´
â€¢ æ€§èƒ½ä¼˜å…ˆï¼šæ¯«ç§’çº§å»¶è¿Ÿè¦æ±‚
â€¢ å¤§æ•°æ®å¤„ç†ï¼šé…åˆæµè®¡ç®—æ¡†æ¶

é€‰æ‹©RocketMQçš„åœºæ™¯ï¼š
â€¢ å¯é æ€§é«˜ï¼šé‡‘èã€æ”¯ä»˜ç­‰åœºæ™¯
â€¢ åŠŸèƒ½ä¸°å¯Œï¼šéœ€è¦äº‹åŠ¡æ¶ˆæ¯ã€å»¶è¿Ÿæ¶ˆæ¯
â€¢ è¿ç»´ç®€å•ï¼šéœ€è¦å‹å¥½çš„ç®¡ç†ç•Œé¢
```

**ğŸ”¹ å¯é æ€§ä¿è¯æœºåˆ¶**
```
ä¸‰ä¸ªå…³é”®ç‚¹ï¼š
1. æ¶ˆæ¯ä¸ä¸¢å¤±ï¼šç”Ÿäº§è€…ç¡®è®¤ + æŒä¹…åŒ–å­˜å‚¨
2. æ¶ˆæ¯ä¸é‡å¤ï¼šä¸šåŠ¡å¹‚ç­‰ + å»é‡æœºåˆ¶  
3. æ¶ˆæ¯æœ‰åºæ€§ï¼šåˆ†åŒºç­–ç•¥ + é¡ºåºæ¶ˆè´¹
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- **æ•°æ®åŒæ­¥**ï¼šä¸»åº“å˜æ›´å®æ—¶åŒæ­¥åˆ°ä»åº“ã€ç¼“å­˜
- **æœç´¢ç´¢å¼•**ï¼šæ•°æ®å˜æ›´å®æ—¶æ›´æ–°Elasticsearch
- **ä¸šåŠ¡è§£è€¦**ï¼šè®¢å•å˜æ›´è§¦å‘åº“å­˜ã€ç§¯åˆ†ã€é€šçŸ¥ç­‰å¤„ç†
- **æ•°æ®åˆ†æ**ï¼šå®æ—¶æ•°æ®æµå…¥å¤§æ•°æ®å¹³å°åˆ†æ

**æ¶æ„è®¾è®¡ä»·å€¼**ï¼š
- **ç³»ç»Ÿè§£è€¦**ï¼šå‡å°‘ç³»ç»Ÿé—´ç›´æ¥ä¾èµ–
- **æ€§èƒ½æå‡**ï¼šé¿å…é¢‘ç¹æ•°æ®åº“æŸ¥è¯¢
- **æ‰©å±•æ€§å¥½**ï¼šæ–°å¢è®¢é˜…è€…æ— éœ€ä¿®æ”¹ç°æœ‰ç³»ç»Ÿ
- **å®æ—¶æ€§å¼º**ï¼šæ»¡è¶³å®æ—¶ä¸šåŠ¡å¤„ç†éœ€æ±‚

### 9.4 è¿ç»´å®è·µè¦ç‚¹


**éƒ¨ç½²å»ºè®®**ï¼š
```
ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š
â€¢ Canalï¼šé›†ç¾¤éƒ¨ç½²ï¼Œä¸»å¤‡åˆ‡æ¢
â€¢ Kafkaï¼š3ä¸ªBrokerï¼Œå‰¯æœ¬æ•°2
â€¢ RocketMQï¼š2ä¸ªMasterï¼Œæ¯ä¸ªå¸¦1ä¸ªSlave
â€¢ ç›‘æ§ï¼šPrometheus + Grafana
```

**å¸¸è§é—®é¢˜å¤„ç†**ï¼š
```
æ¶ˆæ¯ç§¯å‹ï¼š
â†’ å¢åŠ æ¶ˆè´¹è€…å®ä¾‹
â†’ ä¼˜åŒ–æ¶ˆè´¹é€»è¾‘
â†’ æ£€æŸ¥ç½‘ç»œå’Œå­˜å‚¨

æ¶ˆæ¯é‡å¤ï¼š
â†’ æ£€æŸ¥å¹‚ç­‰é€»è¾‘
â†’ ç¡®è®¤æäº¤æœºåˆ¶
â†’ æŸ¥çœ‹é‡è¯•é…ç½®

æ•°æ®ä¸ä¸€è‡´ï¼š
â†’ æ£€æŸ¥æ¶ˆæ¯é¡ºåº
â†’ ç¡®è®¤äº‹åŠ¡å¤„ç†
â†’ éªŒè¯è¡¥å¿æœºåˆ¶
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Canalè®¢é˜…æ¨¡å¼è§£è€¦å¥½ï¼Œå®æ—¶æ¨é€å»¶è¿Ÿå°
- Kafkaæ€§èƒ½RocketMQå¯é ï¼ŒæŒ‰éœ€é€‰æ‹©å¾ˆé‡è¦  
- æ¶ˆæ¯æ ¼å¼è¦ç»Ÿä¸€ï¼Œå¹‚ç­‰é¡ºåºä¸èƒ½å°‘
- ç›‘æ§å‘Šè­¦è¦åˆ°ä½ï¼Œå®¹é‡è§„åˆ’æ—©çŸ¥é“