---
title: 9ã€Canalç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [Canalä¸MySQLç‰ˆæœ¬å…¼å®¹æ€§åŸºç¡€](#1-Canalä¸MySQLç‰ˆæœ¬å…¼å®¹æ€§åŸºç¡€)
2. [Canalç‰ˆæœ¬é€‰æ‹©ç­–ç•¥](#2-Canalç‰ˆæœ¬é€‰æ‹©ç­–ç•¥)
3. [å‡çº§è¿ç§»æ–¹æ¡ˆè®¾è®¡](#3-å‡çº§è¿ç§»æ–¹æ¡ˆè®¾è®¡)
4. [å…¼å®¹æ€§æµ‹è¯•æ–¹æ³•](#4-å…¼å®¹æ€§æµ‹è¯•æ–¹æ³•)
5. [ç‰ˆæœ¬å·®å¼‚å¤„ç†ç­–ç•¥](#5-ç‰ˆæœ¬å·®å¼‚å¤„ç†ç­–ç•¥)
6. [å‘åå…¼å®¹ä¿è¯æœºåˆ¶](#6-å‘åå…¼å®¹ä¿è¯æœºåˆ¶)
7. [ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ](#7-ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— Canalä¸MySQLç‰ˆæœ¬å…¼å®¹æ€§åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯Canalç‰ˆæœ¬å…¼å®¹æ€§


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
Canalç‰ˆæœ¬å…¼å®¹æ€§ï¼šæŒ‡Canalä¸­é—´ä»¶ä¸ä¸åŒç‰ˆæœ¬MySQLæ•°æ®åº“
ä¹‹é—´èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„èƒ½åŠ›

å…³é”®ç»´åº¦ï¼š
â€¢ MySQL Serverç‰ˆæœ¬é€‚é…
â€¢ Binlogæ ¼å¼å…¼å®¹æ€§  
â€¢ åè®®ç‰ˆæœ¬åŒ¹é…
â€¢ åŠŸèƒ½ç‰¹æ€§æ”¯æŒåº¦
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨å…¼å®¹æ€§**
Canalä½œä¸ºæ•°æ®åŒæ­¥ä¸­é—´ä»¶ï¼Œéœ€è¦æ·±åº¦è§£æMySQLçš„binlogã€‚ä¸åŒMySQLç‰ˆæœ¬çš„binlogæ ¼å¼ã€äº‹ä»¶ç±»å‹ã€åè®®ç»†èŠ‚éƒ½å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œè¿™å°±è¦æ±‚Canalå¿…é¡»é€‚é…è¿™äº›å˜åŒ–ã€‚

### 1.2 å…¼å®¹æ€§å½±å“å› ç´ 


**ğŸ“Š ä¸»è¦å½±å“å› ç´ åˆ†æ**

| å› ç´ ç±»å‹ | **å…·ä½“å†…å®¹** | **å½±å“ç¨‹åº¦** | **å¤„ç†éš¾åº¦** |
|---------|------------|-------------|-------------|
| ğŸ”¸ **MySQLç‰ˆæœ¬** | `5.6/5.7/8.0ä¸»è¦ç‰ˆæœ¬å·®å¼‚` | `é«˜` | `ä¸­ç­‰` |
| ğŸ”¸ **Binlogæ ¼å¼** | `ROW/STATEMENT/MIXEDæ¨¡å¼` | `é«˜` | `ä½` |
| ğŸ”¸ **å­—ç¬¦é›†ç¼–ç ** | `utf8/utf8mb4/latin1ç­‰` | `ä¸­` | `ä½` |
| ğŸ”¸ **å­˜å‚¨å¼•æ“** | `InnoDB/MyISAMç‰¹æ€§å·®å¼‚` | `ä¸­` | `ä¸­ç­‰` |
| ğŸ”¸ **å¤åˆ¶åè®®** | `GTID/ä¼ ç»Ÿå¤åˆ¶æ¨¡å¼` | `é«˜` | `é«˜` |

### 1.3 å…¼å®¹æ€§çŸ©é˜µæ¦‚è§ˆ


**ğŸ—‚ï¸ Canalä¸MySQLç‰ˆæœ¬å¯¹åº”å…³ç³»**
```
Canal 1.1.x ç³»åˆ—ï¼š
â”œâ”€ MySQL 5.6.x âœ… å®Œå…¨æ”¯æŒ
â”œâ”€ MySQL 5.7.x âœ… å®Œå…¨æ”¯æŒ  
â””â”€ MySQL 8.0.x âš ï¸ éƒ¨åˆ†æ”¯æŒ

Canal 1.1.4+ ç³»åˆ—ï¼š
â”œâ”€ MySQL 5.6.x âœ… å®Œå…¨æ”¯æŒ
â”œâ”€ MySQL 5.7.x âœ… å®Œå…¨æ”¯æŒ
â””â”€ MySQL 8.0.x âœ… å®Œå…¨æ”¯æŒ

Canal 1.1.5+ ç³»åˆ—ï¼š
â””â”€ MySQL 8.0.x âœ… å®Œå…¨æ”¯æŒï¼ˆæ¨èï¼‰
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> Canalç‰ˆæœ¬é€‰æ‹©çš„æ ¸å¿ƒåŸåˆ™æ˜¯ï¼šå…ˆç¡®å®šMySQLç‰ˆæœ¬ï¼Œå†é€‰æ‹©å¯¹åº”çš„Canalç‰ˆæœ¬

---

## 2. ğŸ¯ Canalç‰ˆæœ¬é€‰æ‹©ç­–ç•¥


### 2.1 åŸºäºMySQLç‰ˆæœ¬çš„é€‰æ‹©


**ğŸ”¸ MySQL 5.6ç¯å¢ƒ**
```yaml
æ¨èé…ç½®ï¼š
Canalç‰ˆæœ¬: 1.1.4+
é€‰æ‹©ç†ç”±:
â€¢ æˆç†Ÿç¨³å®šï¼Œbugä¿®å¤å®Œå–„
â€¢ ç¤¾åŒºæ”¯æŒè‰¯å¥½
â€¢ æ–‡æ¡£èµ„æ–™ä¸°å¯Œ

æ³¨æ„äº‹é¡¹ï¼š
â€¢ ä¸æ”¯æŒJSONæ•°æ®ç±»å‹
â€¢ éƒ¨åˆ†æ–°ç‰¹æ€§æ— æ³•ä½¿ç”¨
```

**ğŸ”¸ MySQL 5.7ç¯å¢ƒ**
```yaml
æ¨èé…ç½®ï¼š
Canalç‰ˆæœ¬: 1.1.4+ æˆ– 1.1.5+
æ–°å¢ç‰¹æ€§æ”¯æŒï¼š
â€¢ JSONæ•°æ®ç±»å‹è§£æ
â€¢ Generated Columnæ”¯æŒ
â€¢ æ›´å¥½çš„GTIDæ”¯æŒ

é€‰æ‹©å»ºè®®ï¼š
â€¢ ç”Ÿäº§ç¯å¢ƒï¼š1.1.4ï¼ˆç¨³å®šæ€§ä¼˜å…ˆï¼‰
â€¢ æµ‹è¯•ç¯å¢ƒï¼š1.1.5+ï¼ˆæ–°ç‰¹æ€§ä½“éªŒï¼‰
```

**ğŸ”¸ MySQL 8.0ç¯å¢ƒ**
```yaml
å¼ºåˆ¶è¦æ±‚ï¼š
Canalç‰ˆæœ¬: 1.1.5+
å…³é”®é€‚é…ï¼š
â€¢ è®¤è¯æ–¹å¼å˜æ›´ï¼ˆcaching_sha2_passwordï¼‰
â€¢ Binlogæ ¼å¼è°ƒæ•´
â€¢ æ–°çš„æ•°æ®ç±»å‹æ”¯æŒ

å¿…è¦é…ç½®ï¼š
default_authentication_plugin=mysql_native_password
```

### 2.2 ä¸šåŠ¡åœºæ™¯å¯¼å‘é€‰æ‹©


**âš¡ é«˜å¯ç”¨åœºæ™¯**
```
åœºæ™¯ç‰¹ç‚¹ï¼š
â€¢ 7Ã—24å°æ—¶ä¸é—´æ–­è¿è¡Œ
â€¢ æ•…éšœæ¢å¤æ—¶é—´è¦æ±‚æçŸ­
â€¢ æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼

ç‰ˆæœ¬é€‰æ‹©ï¼š
â€¢ ä¼˜å…ˆé€‰æ‹©LTSç‰ˆæœ¬
â€¢ é¿å…ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
â€¢ é€‰æ‹©ç»è¿‡é•¿æœŸéªŒè¯çš„ç¨³å®šç‰ˆæœ¬

æ¨èï¼šCanal 1.1.4 + MySQL 5.7
```

**ğŸš€ æ–°é¡¹ç›®åœºæ™¯**
```
åœºæ™¯ç‰¹ç‚¹ï¼š
â€¢ å¯ä»¥æ¥å—ä¸€å®šè¯•é”™æˆæœ¬
â€¢ å¸Œæœ›ä½¿ç”¨æœ€æ–°ç‰¹æ€§
â€¢ æœªæ¥æ‰©å±•æ€§è¦æ±‚é«˜

ç‰ˆæœ¬é€‰æ‹©ï¼š
â€¢ å¯ä»¥é€‰æ‹©è¾ƒæ–°ç‰ˆæœ¬
â€¢ è€ƒè™‘æœªæ¥å‡çº§è·¯å¾„
â€¢ å…³æ³¨æ–°ç‰¹æ€§æ”¯æŒ

æ¨èï¼šCanal 1.1.5+ + MySQL 8.0
```

### 2.3 ç‰ˆæœ¬é€‰æ‹©å†³ç­–æµç¨‹


```
ç‰ˆæœ¬é€‰æ‹©å†³ç­–æµç¨‹ï¼š

å½“å‰MySQLç‰ˆæœ¬æ˜¯ä»€ä¹ˆï¼Ÿ
â”œâ”€ MySQL 5.6 â†’ Canal 1.1.4
â”œâ”€ MySQL 5.7 â†’ Canal 1.1.4+ 
â””â”€ MySQL 8.0 â†’ Canal 1.1.5+

ä¸šåŠ¡ç¨³å®šæ€§è¦æ±‚ï¼Ÿ
â”œâ”€ é«˜ç¨³å®šæ€§ â†’ é€‰æ‹©æˆç†Ÿç‰ˆæœ¬
â””â”€ å¯æ¥å—é£é™© â†’ é€‰æ‹©æ–°ç‰ˆæœ¬

æ˜¯å¦éœ€è¦æ–°ç‰¹æ€§ï¼Ÿ
â”œâ”€ éœ€è¦JSONæ”¯æŒ â†’ MySQL 5.7+
â”œâ”€ éœ€è¦æ–°è®¤è¯ â†’ MySQL 8.0+
â””â”€ åŸºç¡€åŠŸèƒ½å¤Ÿç”¨ â†’ ä»»æ„ç‰ˆæœ¬

å›¢é˜ŸæŠ€æœ¯èƒ½åŠ›ï¼Ÿ
â”œâ”€ å¼ºæŠ€æœ¯å›¢é˜Ÿ â†’ å¯é€‰æ–°ç‰ˆæœ¬
â””â”€ ä¸€èˆ¬æŠ€æœ¯å›¢é˜Ÿ â†’ é€‰æ‹©ç¨³å®šç‰ˆæœ¬
```

---

## 3. ğŸ”„ å‡çº§è¿ç§»æ–¹æ¡ˆè®¾è®¡


### 3.1 å‡çº§å‰è¯„ä¼°


**ğŸ“‹ å‡çº§å…¼å®¹æ€§æ£€æŸ¥æ¸…å•**
```
âœ… MySQLç‰ˆæœ¬å…¼å®¹æ€§ç¡®è®¤
âœ… å½“å‰Canalç‰ˆæœ¬åŠŸèƒ½æ¸…å•
âœ… ç›®æ ‡ç‰ˆæœ¬æ–°ç‰¹æ€§äº†è§£
âœ… é…ç½®æ–‡ä»¶å·®å¼‚åˆ†æ
âœ… ä¾èµ–ç»„ä»¶ç‰ˆæœ¬æ£€æŸ¥
âœ… ä¸šåŠ¡å½±å“èŒƒå›´è¯„ä¼°
âœ… å›æ»šæ–¹æ¡ˆå‡†å¤‡
```

**ğŸ” å…³é”®æ£€æŸ¥é¡¹ç›®**
```yaml
# 1. MySQLç‰ˆæœ¬æ£€æŸ¥
SELECT VERSION();

# 2. Binlogæ ¼å¼æ£€æŸ¥  
SHOW VARIABLES LIKE 'binlog_format';

# 3. GTIDçŠ¶æ€æ£€æŸ¥
SHOW VARIABLES LIKE 'gtid_mode';

# 4. å­—ç¬¦é›†æ£€æŸ¥
SHOW VARIABLES LIKE 'character_set%';
```

### 3.2 å‡çº§æ–¹æ¡ˆè®¾è®¡


**ğŸ¯ æ»šåŠ¨å‡çº§æ–¹æ¡ˆ**
```
é€‚ç”¨åœºæ™¯ï¼šå¤šå®ä¾‹Canalé›†ç¾¤

å‡çº§æ­¥éª¤ï¼š
1. å‡†å¤‡é˜¶æ®µ
   â”œâ”€ å¤‡ä»½å½“å‰é…ç½®
   â”œâ”€ å‡†å¤‡æ–°ç‰ˆæœ¬ç¨‹åº
   â””â”€ åˆ¶å®šè¯¦ç»†è®¡åˆ’

2. é€ä¸ªå‡çº§
   â”œâ”€ åœæ­¢å•ä¸ªCanalå®ä¾‹
   â”œâ”€ æ›¿æ¢ç¨‹åºæ–‡ä»¶
   â”œâ”€ æ›´æ–°é…ç½®æ–‡ä»¶
   â””â”€ å¯åŠ¨å¹¶éªŒè¯

3. éªŒè¯é˜¶æ®µ
   â”œâ”€ åŠŸèƒ½éªŒè¯
   â”œâ”€ æ€§èƒ½éªŒè¯
   â””â”€ ä¸šåŠ¡éªŒè¯
```

**âš¡ è“ç»¿éƒ¨ç½²æ–¹æ¡ˆ**
```
é€‚ç”¨åœºæ™¯ï¼šå•å®ä¾‹æˆ–è¦æ±‚é›¶åœæœº

éƒ¨ç½²æ­¥éª¤ï¼š
1. ç¯å¢ƒå‡†å¤‡
   ç»¿ç¯å¢ƒï¼šå½“å‰è¿è¡Œç‰ˆæœ¬
   è“ç¯å¢ƒï¼šæ–°ç‰ˆæœ¬ç¯å¢ƒ

2. åˆ‡æ¢è¿‡ç¨‹
   â”œâ”€ è“ç¯å¢ƒéƒ¨ç½²æ–°ç‰ˆæœ¬
   â”œâ”€ æ•°æ®åŒæ­¥è¿½èµ¶
   â”œâ”€ æµé‡åˆ‡æ¢åˆ°è“ç¯å¢ƒ
   â””â”€ ç»¿ç¯å¢ƒä¿ç•™å¤‡ç”¨

3. éªŒè¯å®Œæˆ
   â”œâ”€ è“ç¯å¢ƒéªŒè¯é€šè¿‡
   â””â”€ ç»¿ç¯å¢ƒå¯å›æ”¶
```

### 3.3 å‡çº§è„šæœ¬ç¤ºä¾‹


```bash
#!/bin/bash
# Canalç‰ˆæœ¬å‡çº§è„šæœ¬

# é…ç½®å˜é‡
OLD_VERSION="1.1.4"
NEW_VERSION="1.1.5"
CANAL_HOME="/opt/canal"
BACKUP_DIR="/opt/canal_backup"

# 1. åˆ›å»ºå¤‡ä»½
echo "åˆ›å»ºé…ç½®å¤‡ä»½..."
mkdir -p $BACKUP_DIR
cp -r $CANAL_HOME/conf $BACKUP_DIR/
cp -r $CANAL_HOME/bin $BACKUP_DIR/

# 2. åœæ­¢æœåŠ¡
echo "åœæ­¢CanalæœåŠ¡..."
$CANAL_HOME/bin/stop.sh

# 3. æ›¿æ¢ç¨‹åºæ–‡ä»¶
echo "æ›¿æ¢ç¨‹åºæ–‡ä»¶..."
wget https://github.com/alibaba/canal/releases/download/canal-$NEW_VERSION/canal.deployer-$NEW_VERSION.tar.gz
tar -xzf canal.deployer-$NEW_VERSION.tar.gz -C /tmp/
cp -r /tmp/canal/* $CANAL_HOME/

# 4. é…ç½®æ–‡ä»¶é€‚é…
echo "æ›´æ–°é…ç½®æ–‡ä»¶..."
# è¿™é‡Œæ ¹æ®ç‰ˆæœ¬å·®å¼‚è°ƒæ•´é…ç½®
sed -i 's/old_config/new_config/g' $CANAL_HOME/conf/canal.properties

# 5. å¯åŠ¨æœåŠ¡
echo "å¯åŠ¨CanalæœåŠ¡..."
$CANAL_HOME/bin/startup.sh

# 6. éªŒè¯å¯åŠ¨
sleep 10
if [ -f $CANAL_HOME/logs/canal/canal.log ]; then
    echo "å‡çº§å®Œæˆï¼Œæ£€æŸ¥æ—¥å¿—ï¼š"
    tail -n 20 $CANAL_HOME/logs/canal/canal.log
else
    echo "å‡çº§å¤±è´¥ï¼Œæ£€æŸ¥é”™è¯¯ä¿¡æ¯"
    exit 1
fi
```

---

## 4. ğŸ§ª å…¼å®¹æ€§æµ‹è¯•æ–¹æ³•


### 4.1 æµ‹è¯•ç¯å¢ƒæ­å»º


**ğŸ—ï¸ å¤šç‰ˆæœ¬æµ‹è¯•ç¯å¢ƒ**
```
æµ‹è¯•ç¯å¢ƒæ¶æ„ï¼š

MySQL 5.6 â†â†’ Canal 1.1.4
    â†“
   éªŒè¯åŒæ­¥åŠŸèƒ½

MySQL 5.7 â†â†’ Canal 1.1.5  
    â†“
   éªŒè¯æ–°ç‰¹æ€§

MySQL 8.0 â†â†’ Canal 1.1.5+
    â†“
   éªŒè¯å®Œæ•´å…¼å®¹æ€§
```

**ğŸ³ Dockeræµ‹è¯•ç¯å¢ƒ**
```yaml
# docker-compose.yml
version: '3'
services:
  mysql56:
    image: mysql:5.6
    environment:
      MYSQL_ROOT_PASSWORD: canal
    ports:
      - "3356:3306"
      
  mysql57:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: canal
    ports:
      - "3357:3306"
      
  mysql80:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: canal
    ports:
      - "3380:3306"
      
  canal-test:
    image: canal/canal-server:v1.1.5
    depends_on:
      - mysql57
    ports:
      - "11111:11111"
```

### 4.2 è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬


**ğŸ”¬ åŸºç¡€å…¼å®¹æ€§æµ‹è¯•**
```python
#!/usr/bin/env python3
# Canalå…¼å®¹æ€§è‡ªåŠ¨æµ‹è¯•è„šæœ¬

import pymysql
import requests
import time
import json

class CanalCompatibilityTest:
    def __init__(self, mysql_config, canal_config):
        self.mysql_config = mysql_config
        self.canal_config = canal_config
        
    def test_basic_sync(self):
        """æµ‹è¯•åŸºæœ¬åŒæ­¥åŠŸèƒ½"""
        # 1. è¿æ¥MySQL
        conn = pymysql.connect(**self.mysql_config)
        cursor = conn.cursor()
        
        # 2. åˆ›å»ºæµ‹è¯•è¡¨
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS test_sync (
                id INT PRIMARY KEY AUTO_INCREMENT,
                name VARCHAR(100),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """)
        
        # 3. æ’å…¥æµ‹è¯•æ•°æ®
        cursor.execute("INSERT INTO test_sync (name) VALUES ('test_data')")
        conn.commit()
        
        # 4. éªŒè¯Canalæ˜¯å¦æ•è·åˆ°å˜åŒ–
        time.sleep(2)
        result = self.check_canal_log()
        
        cursor.close()
        conn.close()
        
        return result
        
    def test_data_types(self):
        """æµ‹è¯•å„ç§æ•°æ®ç±»å‹å…¼å®¹æ€§"""
        test_cases = [
            ("VARCHAR", "'hello world'"),
            ("INT", "123"),
            ("DECIMAL", "123.45"),
            ("DATETIME", "'2023-01-01 12:00:00'"),
        ]
        
        # MySQL 5.7+ ç‰¹æœ‰ç±»å‹
        if self.mysql_config.get('version', '5.6') >= '5.7':
            test_cases.append(("JSON", "'{\"key\": \"value\"}'"))
            
        results = []
        for data_type, value in test_cases:
            result = self._test_single_type(data_type, value)
            results.append((data_type, result))
            
        return results
        
    def _test_single_type(self, data_type, value):
        """æµ‹è¯•å•ä¸ªæ•°æ®ç±»å‹"""
        try:
            conn = pymysql.connect(**self.mysql_config)
            cursor = conn.cursor()
            
            # åˆ›å»ºæµ‹è¯•è¡¨
            cursor.execute(f"""
                CREATE TABLE IF NOT EXISTS test_{data_type.lower()} (
                    id INT PRIMARY KEY AUTO_INCREMENT,
                    test_column {data_type}
                )
            """)
            
            # æ’å…¥æ•°æ®
            cursor.execute(f"INSERT INTO test_{data_type.lower()} (test_column) VALUES ({value})")
            conn.commit()
            
            cursor.close()
            conn.close()
            return True
            
        except Exception as e:
            print(f"æµ‹è¯• {data_type} å¤±è´¥: {e}")
            return False
```

### 4.3 æ€§èƒ½å…¼å®¹æ€§æµ‹è¯•


**âš¡ æ€§èƒ½åŸºå‡†æµ‹è¯•**
```bash
#!/bin/bash
# Canalæ€§èƒ½å…¼å®¹æ€§æµ‹è¯•

# æµ‹è¯•å‚æ•°
TEST_DURATION=300  # 5åˆ†é’Ÿ
TPS_TARGET=1000    # ç›®æ ‡TPS

echo "å¼€å§‹æ€§èƒ½å…¼å®¹æ€§æµ‹è¯•..."

# 1. å‡†å¤‡æµ‹è¯•æ•°æ®
mysql -h localhost -u root -p canal_test << EOF
CREATE DATABASE IF NOT EXISTS perf_test;
USE perf_test;

CREATE TABLE IF NOT EXISTS test_table (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    data VARCHAR(1000),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
EOF

# 2. å¯åŠ¨å‹åŠ›æµ‹è¯•
python3 << EOF
import pymysql
import threading
import time
import random
import string

def generate_data():
    return ''.join(random.choices(string.ascii_letters, k=100))

def insert_worker(duration):
    conn = pymysql.connect(
        host='localhost',
        user='root', 
        password='canal',
        database='perf_test'
    )
    cursor = conn.cursor()
    
    start_time = time.time()
    count = 0
    
    while time.time() - start_time < duration:
        try:
            data = generate_data()
            cursor.execute(
                "INSERT INTO test_table (data) VALUES (%s)", 
                (data,)
            )
            conn.commit()
            count += 1
        except Exception as e:
            print(f"æ’å…¥é”™è¯¯: {e}")
            
    cursor.close()
    conn.close()
    print(f"çº¿ç¨‹å®Œæˆï¼Œæ’å…¥è®°å½•æ•°: {count}")

# å¯åŠ¨å¤šä¸ªçº¿ç¨‹
threads = []
for i in range(10):
    t = threading.Thread(target=insert_worker, args=($TEST_DURATION,))
    threads.append(t)
    t.start()

for t in threads:
    t.join()
    
print("æ€§èƒ½æµ‹è¯•å®Œæˆ")
EOF

# 3. æ£€æŸ¥Canalå¤„ç†æƒ…å†µ
echo "æ£€æŸ¥Canalæ—¥å¿—..."
tail -n 50 /opt/canal/logs/example/example.log
```

---

## 5. âš–ï¸ ç‰ˆæœ¬å·®å¼‚å¤„ç†ç­–ç•¥


### 5.1 MySQLç‰ˆæœ¬å·®å¼‚è¯†åˆ«


**ğŸ” å…³é”®å·®å¼‚ç‚¹åˆ†æ**

```
MySQL 5.6 â†’ 5.7 ä¸»è¦å·®å¼‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ JSONæ•°æ®ç±»å‹æ–°å¢                    â”‚
â”‚ â€¢ Generated Columnæ”¯æŒ               â”‚  
â”‚ â€¢ æ›´ä¸¥æ ¼çš„SQLæ¨¡å¼                     â”‚
â”‚ â€¢ æ€§èƒ½ä¼˜åŒ–æ”¹è¿›                        â”‚
â”‚ â€¢ GTIDåŠŸèƒ½å¢å¼º                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MySQL 5.7 â†’ 8.0 ä¸»è¦å·®å¼‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ é»˜è®¤è®¤è¯æ’ä»¶å˜æ›´                     â”‚
â”‚ â€¢ å­—ç¬¦é›†é»˜è®¤æ”¹ä¸ºutf8mb4               â”‚
â”‚ â€¢ çª—å£å‡½æ•°æ”¯æŒ                        â”‚
â”‚ â€¢ CTE(å…¬ç”¨è¡¨è¡¨è¾¾å¼)æ”¯æŒ                â”‚
â”‚ â€¢ è§’è‰²ç®¡ç†åŠŸèƒ½                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 é…ç½®å·®å¼‚å¤„ç†


**ğŸ”§ MySQL 8.0é€‚é…é…ç½®**
```sql
-- è§£å†³è®¤è¯é—®é¢˜
ALTER USER 'canal'@'%' IDENTIFIED WITH mysql_native_password BY 'canal';

-- è®¾ç½®å…¼å®¹çš„å­—ç¬¦é›†
SET GLOBAL character_set_server=utf8mb4;
SET GLOBAL collation_server=utf8mb4_general_ci;

-- ç¡®ä¿binlogæ ¼å¼æ­£ç¡®
SET GLOBAL binlog_format=ROW;
SET GLOBAL binlog_row_image=FULL;
```

**ğŸ“ Canalé…ç½®é€‚é…**
```properties
# canal.properties 8.0é€‚é…
canal.instance.mysql.slaveId=1234
canal.instance.master.address=127.0.0.1:3306
canal.instance.dbUsername=canal
canal.instance.dbPassword=canal

# MySQL 8.0ç‰¹æ®Šé…ç½®
canal.instance.connectionCharset=UTF-8
canal.instance.enableDruid=false
canal.instance.filter.regex=.*\\..*

# å¤„ç†è®¤è¯æ–¹å¼
canal.instance.defaultDatabaseName=test
```

### 5.3 ä»£ç å±‚é¢é€‚é…


**ğŸ’» å®¢æˆ·ç«¯é€‚é…ä»£ç **
```java
public class CanalVersionAdapter {
    
    public void adaptToMySQLVersion(String mysqlVersion) {
        if (mysqlVersion.startsWith("8.0")) {
            // MySQL 8.0é€‚é…é€»è¾‘
            handleMySQL80Features();
        } else if (mysqlVersion.startsWith("5.7")) {
            // MySQL 5.7é€‚é…é€»è¾‘  
            handleMySQL57Features();
        } else {
            // MySQL 5.6å…¼å®¹é€»è¾‘
            handleMySQL56Features();
        }
    }
    
    private void handleMySQL80Features() {
        // å¤„ç†æ–°çš„æ•°æ®ç±»å‹
        registerCustomTypeHandlers();
        
        // é€‚é…è®¤è¯æ–¹å¼
        configureAuthentication();
        
        // å¤„ç†å­—ç¬¦é›†å˜åŒ–
        configureCharset("utf8mb4");
    }
    
    private void handleMySQL57Features() {
        // JSONç±»å‹æ”¯æŒ
        enableJSONSupport();
        
        // Generated Columnå¤„ç†
        handleGeneratedColumns();
    }
    
    private void handleMySQL56Features() {
        // åŸºç¡€åŠŸèƒ½é…ç½®
        configureBasicFeatures();
    }
}
```

---

## 6. ğŸ”’ å‘åå…¼å®¹ä¿è¯æœºåˆ¶


### 6.1 å…¼å®¹æ€§ä¿è¯ç­–ç•¥


**ğŸ¯ æ ¸å¿ƒåŸåˆ™**
```
å‘åå…¼å®¹åŸåˆ™ï¼š
â€¢ æ–°ç‰ˆæœ¬å¿…é¡»æ”¯æŒæ—§ç‰ˆæœ¬åŠŸèƒ½
â€¢ é…ç½®æ–‡ä»¶å‘ä¸‹å…¼å®¹
â€¢ APIæ¥å£ä¿æŒç¨³å®š
â€¢ æ•°æ®æ ¼å¼ä¿æŒä¸€è‡´
```

**ğŸ”„ å…¼å®¹æ€§æ£€æŸ¥æœºåˆ¶**
```java
public class CompatibilityChecker {
    
    public boolean checkBackwardCompatibility(String oldVersion, String newVersion) {
        // 1. æ£€æŸ¥é…ç½®æ–‡ä»¶å…¼å®¹æ€§
        boolean configCompatible = checkConfigCompatibility(oldVersion, newVersion);
        
        // 2. æ£€æŸ¥APIå…¼å®¹æ€§
        boolean apiCompatible = checkAPICompatibility(oldVersion, newVersion);
        
        // 3. æ£€æŸ¥æ•°æ®æ ¼å¼å…¼å®¹æ€§
        boolean dataCompatible = checkDataCompatibility(oldVersion, newVersion);
        
        return configCompatible && apiCompatible && dataCompatible;
    }
    
    private boolean checkConfigCompatibility(String oldVersion, String newVersion) {
        // æ£€æŸ¥é…ç½®é¡¹æ˜¯å¦è¿˜æ”¯æŒ
        Set<String> oldConfigs = loadConfigKeys(oldVersion);
        Set<String> newConfigs = loadConfigKeys(newVersion);
        
        // ç¡®ä¿æ—§é…ç½®åœ¨æ–°ç‰ˆæœ¬ä¸­ä»ç„¶æœ‰æ•ˆ
        return newConfigs.containsAll(oldConfigs);
    }
}
```

### 6.2 é™çº§å›æ»šæœºåˆ¶


**â¬‡ï¸ è‡ªåŠ¨é™çº§ç­–ç•¥**
```yaml
é™çº§è§¦å‘æ¡ä»¶ï¼š
  - æ–°ç‰ˆæœ¬å¯åŠ¨å¤±è´¥
  - å…¼å®¹æ€§æ£€æŸ¥ä¸é€šè¿‡  
  - æ€§èƒ½æŒ‡æ ‡ä¸¥é‡ä¸‹é™
  - ä¸šåŠ¡åŠŸèƒ½å¼‚å¸¸

é™çº§æ‰§è¡Œæ­¥éª¤ï¼š
  1. åœæ­¢æ–°ç‰ˆæœ¬æœåŠ¡
  2. æ¢å¤æ—§ç‰ˆæœ¬ç¨‹åº
  3. è¿˜åŸé…ç½®æ–‡ä»¶
  4. é‡å¯æœåŠ¡
  5. éªŒè¯åŠŸèƒ½æ­£å¸¸
```

**ğŸ”„ å›æ»šè„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# Canalç‰ˆæœ¬å›æ»šè„šæœ¬

CANAL_HOME="/opt/canal"
BACKUP_DIR="/opt/canal_backup"

echo "å¼€å§‹å›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬..."

# 1. åœæ­¢å½“å‰æœåŠ¡
$CANAL_HOME/bin/stop.sh

# 2. å¤‡ä»½å½“å‰çŠ¶æ€ï¼ˆç”¨äºé—®é¢˜åˆ†æï¼‰
mkdir -p /opt/canal_failed_upgrade
cp -r $CANAL_HOME/logs /opt/canal_failed_upgrade/
cp -r $CANAL_HOME/conf /opt/canal_failed_upgrade/

# 3. æ¢å¤ç¨‹åºæ–‡ä»¶
if [ -d "$BACKUP_DIR" ]; then
    echo "æ¢å¤å¤‡ä»½æ–‡ä»¶..."
    cp -r $BACKUP_DIR/conf/* $CANAL_HOME/conf/
    cp -r $BACKUP_DIR/bin/* $CANAL_HOME/bin/
else
    echo "å¤‡ä»½ç›®å½•ä¸å­˜åœ¨ï¼Œå›æ»šå¤±è´¥ï¼"
    exit 1
fi

# 4. é‡å¯æœåŠ¡
echo "é‡å¯CanalæœåŠ¡..."
$CANAL_HOME/bin/startup.sh

# 5. éªŒè¯æœåŠ¡çŠ¶æ€
sleep 10
if [ -f $CANAL_HOME/logs/canal/canal.log ]; then
    echo "å›æ»šæˆåŠŸï¼ŒæœåŠ¡å·²å¯åŠ¨"
    tail -n 10 $CANAL_HOME/logs/canal/canal.log
else
    echo "å›æ»šå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
    exit 1
fi
```

---

## 7. ğŸ“‹ ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ


### 7.1 ç‰ˆæœ¬é€‰æ‹©æœ€ä½³å®è·µ


**âœ… é€‰æ‹©åŸåˆ™**
```
1. ç¨³å®šæ€§ä¼˜å…ˆåŸåˆ™
   â€¢ ç”Ÿäº§ç¯å¢ƒé€‰æ‹©ç»è¿‡å……åˆ†éªŒè¯çš„ç‰ˆæœ¬
   â€¢ é¿å…ä½¿ç”¨åˆšå‘å¸ƒçš„ç‰ˆæœ¬
   â€¢ å…³æ³¨ç¤¾åŒºåé¦ˆå’ŒbugæŠ¥å‘Š

2. åŠŸèƒ½éœ€æ±‚åŒ¹é…åŸåˆ™  
   â€¢ æ ¹æ®å®é™…éœ€è¦é€‰æ‹©åŠŸèƒ½ç‰ˆæœ¬
   â€¢ ä¸è¿½æ±‚æœ€æ–°ï¼Œåªæ±‚æœ€åˆé€‚
   â€¢ è¯„ä¼°æ–°åŠŸèƒ½çš„å¿…è¦æ€§

3. æŠ€æœ¯å›¢é˜Ÿèƒ½åŠ›åŸåˆ™
   â€¢ è¯„ä¼°å›¢é˜Ÿçš„æŠ€æœ¯å‚¨å¤‡
   â€¢ è€ƒè™‘è¿ç»´å¤æ‚åº¦
   â€¢ åˆ¶å®šåŸ¹è®­è®¡åˆ’
```

**ğŸ“Š ç‰ˆæœ¬è¯„ä¼°çŸ©é˜µ**

| è¯„ä¼°ç»´åº¦ | **æƒé‡** | **5.6+1.1.4** | **5.7+1.1.4** | **8.0+1.1.5** |
|---------|---------|---------------|---------------|---------------|
| ğŸ”¸ **ç¨³å®šæ€§** | `30%` | `9åˆ†` | `8åˆ†` | `6åˆ†` |
| ğŸ”¸ **åŠŸèƒ½ä¸°å¯Œåº¦** | `25%` | `6åˆ†` | `8åˆ†` | `9åˆ†` |
| ğŸ”¸ **ç¤¾åŒºæ”¯æŒ** | `20%` | `8åˆ†` | `9åˆ†` | `7åˆ†` |
| ğŸ”¸ **è¿ç»´å¤æ‚åº¦** | `15%` | `9åˆ†` | `7åˆ†` | `6åˆ†` |
| ğŸ”¸ **æœªæ¥å‘å±•** | `10%` | `5åˆ†` | `7åˆ†` | `9åˆ†` |
| **æ€»åˆ†** |  | `7.6åˆ†` | `7.8åˆ†` | `7.1åˆ†` |

### 7.2 å‡çº§ç®¡ç†æœ€ä½³å®è·µ


**ğŸš€ æ¸è¿›å¼å‡çº§ç­–ç•¥**
```
å‡çº§é˜¶æ®µè§„åˆ’ï¼š

é˜¶æ®µ1ï¼šæµ‹è¯•ç¯å¢ƒéªŒè¯ï¼ˆ1-2å‘¨ï¼‰
â”œâ”€ æ­å»ºæµ‹è¯•ç¯å¢ƒ
â”œâ”€ åŠŸèƒ½å…¼å®¹æ€§æµ‹è¯•  
â”œâ”€ æ€§èƒ½åŸºå‡†æµ‹è¯•
â””â”€ é—®é¢˜æ”¶é›†æ•´ç†

é˜¶æ®µ2ï¼šç°åº¦ç¯å¢ƒè¯•ç‚¹ï¼ˆ1å‘¨ï¼‰
â”œâ”€ é€‰æ‹©éæ ¸å¿ƒä¸šåŠ¡è¯•ç‚¹
â”œâ”€ å°æµé‡éªŒè¯
â”œâ”€ ç›‘æ§æŒ‡æ ‡å¯¹æ¯”
â””â”€ é—®é¢˜å¿«é€Ÿä¿®å¤

é˜¶æ®µ3ï¼šç”Ÿäº§ç¯å¢ƒæ¨å¹¿ï¼ˆ2-4å‘¨ï¼‰  
â”œâ”€ åˆ¶å®šè¯¦ç»†åˆ‡æ¢è®¡åˆ’
â”œâ”€ å‡†å¤‡å›æ»šé¢„æ¡ˆ
â”œâ”€ åˆ†æ‰¹æ¬¡æ¨å¹¿
â””â”€ å…¨é¢ç›‘æ§éªŒè¯
```

### 7.3 ç›‘æ§å‘Šè­¦æœ€ä½³å®è·µ


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```yaml
# å…¼å®¹æ€§ç›‘æ§é…ç½®
compatibility_monitoring:
  mysql_version_check:
    interval: "1h"
    alert_threshold: "version_mismatch"
    
  canal_status_check:
    interval: "30s" 
    alert_threshold: "connection_failed"
    
  sync_delay_check:
    interval: "1m"
    alert_threshold: "> 5s"
    
  error_rate_check:
    interval: "1m"
    alert_threshold: "> 1%"
```

**ğŸš¨ å‘Šè­¦å¤„ç†æµç¨‹**
```
å‘Šè­¦å¤„ç†SOPï¼š

1. ç‰ˆæœ¬å…¼å®¹æ€§å‘Šè­¦
   â”œâ”€ ç«‹å³æ£€æŸ¥MySQLå’ŒCanalç‰ˆæœ¬
   â”œâ”€ ç¡®è®¤æ˜¯å¦é…ç½®é”™è¯¯
   â”œâ”€ è¯„ä¼°æ˜¯å¦éœ€è¦ç´§æ€¥å›æ»š
   â””â”€ è®°å½•é—®é¢˜å¹¶åˆ¶å®šè§£å†³æ–¹æ¡ˆ

2. åŒæ­¥å»¶è¿Ÿå‘Šè­¦
   â”œâ”€ æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€
   â”œâ”€ åˆ†æbinlogè§£ææ€§èƒ½
   â”œâ”€ ç¡®è®¤æ˜¯å¦ç‰ˆæœ¬å…¼å®¹é—®é¢˜
   â””â”€ ä¼˜åŒ–é…ç½®æˆ–è€ƒè™‘å‡çº§

3. é”™è¯¯ç‡å‘Šè­¦
   â”œâ”€ åˆ†æé”™è¯¯æ—¥å¿—å†…å®¹
   â”œâ”€ è¯†åˆ«æ˜¯å¦å…¼å®¹æ€§é—®é¢˜
   â”œâ”€ å¿«é€Ÿå®šä½æ ¹æœ¬åŸå› 
   â””â”€ å®æ–½ä¿®å¤æªæ–½
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ç‰ˆæœ¬å…¼å®¹æ€§ï¼šCanalä¸MySQLç‰ˆæœ¬é—´çš„é€‚é…å…³ç³»
ğŸ”¸ é€‰æ‹©ç­–ç•¥ï¼šåŸºäºMySQLç‰ˆæœ¬ã€ä¸šåŠ¡åœºæ™¯ã€å›¢é˜Ÿèƒ½åŠ›çš„ç»¼åˆå†³ç­–
ğŸ”¸ å‡çº§æ–¹æ¡ˆï¼šæ»šåŠ¨å‡çº§ã€è“ç»¿éƒ¨ç½²ç­‰é›¶åœæœºå‡çº§æ–¹æ³•
ğŸ”¸ æµ‹è¯•æ–¹æ³•ï¼šåŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å…¼å®¹æ€§æµ‹è¯•çš„ç³»ç»Ÿæ–¹æ³•
ğŸ”¸ å·®å¼‚å¤„ç†ï¼šè¯†åˆ«ç‰ˆæœ¬å·®å¼‚å¹¶åˆ¶å®šé’ˆå¯¹æ€§è§£å†³æ–¹æ¡ˆ
ğŸ”¸ å‘åå…¼å®¹ï¼šä¿è¯æ–°ç‰ˆæœ¬å¯¹æ—§ç‰ˆæœ¬åŠŸèƒ½çš„æ”¯æŒ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç‰ˆæœ¬é€‰æ‹©çš„æ ¸å¿ƒé€»è¾‘**
```
å†³ç­–è·¯å¾„ï¼š
MySQLç‰ˆæœ¬ç¡®å®š â†’ Canalç‰ˆæœ¬ç­›é€‰ â†’ ä¸šåŠ¡éœ€æ±‚åŒ¹é… â†’ é£é™©è¯„ä¼° â†’ æœ€ç»ˆé€‰æ‹©

è®°ä½ï¼šä¸æ˜¯æœ€æ–°çš„å°±æ˜¯æœ€å¥½çš„ï¼Œé€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„
```

**ğŸ”¹ å‡çº§çš„é£é™©æ§åˆ¶**
```
é£é™©æ§åˆ¶è¦ç‚¹ï¼š
â€¢ å……åˆ†çš„æµ‹è¯•éªŒè¯
â€¢ å®Œæ•´çš„å›æ»šé¢„æ¡ˆ  
â€¢ åˆ†é˜¶æ®µæ¸è¿›æ¨è¿›
â€¢ å…¨é¢çš„ç›‘æ§å‘Šè­¦
```

**ğŸ”¹ å…¼å®¹æ€§é—®é¢˜çš„æœ¬è´¨**
```
æœ¬è´¨ç†è§£ï¼š
â€¢ binlogæ ¼å¼å·®å¼‚å¯¼è‡´è§£æé—®é¢˜
â€¢ åè®®å˜æ›´å½±å“è¿æ¥å»ºç«‹
â€¢ æ•°æ®ç±»å‹å·®å¼‚å½±å“åŒæ­¥å‡†ç¡®æ€§
â€¢ è®¤è¯æ–¹å¼å˜æ›´å½±å“æƒé™éªŒè¯
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


- **é£é™©æ§åˆ¶**ï¼šé€šè¿‡ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†é™ä½å‡çº§é£é™©
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé€‰æ‹©æœ€é€‚åˆçš„ç‰ˆæœ¬ç»„åˆè·å¾—æœ€ä½³æ€§èƒ½
- **æˆæœ¬æ§åˆ¶**ï¼šé¿å…é¢‘ç¹å‡çº§å¸¦æ¥çš„è¿ç»´æˆæœ¬
- **ä¸šåŠ¡è¿ç»­æ€§**ï¼šç¡®ä¿æ•°æ®åŒæ­¥æœåŠ¡çš„ç¨³å®šè¿è¡Œ

### 8.4 å¸¸è§è¯¯åŒºé¿å…


> âš ï¸ **å¸¸è§è¯¯åŒº**  
> - ç›²ç›®è¿½æ±‚æœ€æ–°ç‰ˆæœ¬
> - å¿½è§†å…¼å®¹æ€§æµ‹è¯•
> - æ²¡æœ‰å›æ»šé¢„æ¡ˆ
> - ç¼ºä¹ç›‘æ§å‘Šè­¦

> ğŸ’¡ **æ­£ç¡®åšæ³•**  
> - åŸºäºéœ€æ±‚é€‰æ‹©ç‰ˆæœ¬
> - å……åˆ†æµ‹è¯•åå†å‡çº§
> - åˆ¶å®šå®Œæ•´å›æ»šæ–¹æ¡ˆ
> - å»ºç«‹å…¨é¢ç›‘æ§ä½“ç³»

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç‰ˆæœ¬å…¼å®¹æ€§æ˜¯Canalæ­£å¸¸è¿è¡Œçš„åŸºç¡€
- é€‰æ‹©ç‰ˆæœ¬è¦ç»¼åˆè€ƒè™‘ç¨³å®šæ€§ã€åŠŸèƒ½æ€§ã€å›¢é˜Ÿèƒ½åŠ›
- å‡çº§è¦åˆ†é˜¶æ®µéªŒè¯ï¼Œå‡†å¤‡å›æ»šé¢„æ¡ˆ
- æŒç»­ç›‘æ§ç¡®ä¿å…¼å®¹æ€§é—®é¢˜åŠæ—¶å‘ç°å’Œå¤„ç†