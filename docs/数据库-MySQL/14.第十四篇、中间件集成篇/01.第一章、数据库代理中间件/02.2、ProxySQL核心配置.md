---
title: 2ã€ProxySQLæ ¸å¿ƒé…ç½®
---
## ğŸ“š ç›®å½•

1. [ProxySQLé…ç½®ä½“ç³»æ¦‚è¿°](#1-ProxySQLé…ç½®ä½“ç³»æ¦‚è¿°)
2. [é…ç½®æ–‡ä»¶ç»“æ„è¯¦è§£](#2-é…ç½®æ–‡ä»¶ç»“æ„è¯¦è§£)
3. [å¤šå±‚é…ç½®ä½“ç³»](#3-å¤šå±‚é…ç½®ä½“ç³»)
4. [åŠ¨æ€é…ç½®ç®¡ç†](#4-åŠ¨æ€é…ç½®ç®¡ç†)
5. [Adminæ¥å£é…ç½®æ“ä½œ](#5-Adminæ¥å£é…ç½®æ“ä½œ)
6. [é…ç½®æŒä¹…åŒ–ä¸ç‰ˆæœ¬ç®¡ç†](#6-é…ç½®æŒä¹…åŒ–ä¸ç‰ˆæœ¬ç®¡ç†)
7. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#7-å®æˆ˜é…ç½®æ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ProxySQLé…ç½®ä½“ç³»æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ProxySQLé…ç½®ä½“ç³»


ProxySQLçš„é…ç½®ä½“ç³»å°±åƒä¸€ä¸ª**æ™ºèƒ½çš„é…ç½®ç®¡ç†å™¨**ï¼Œå®ƒä¸æ˜¯ç®€å•çš„é…ç½®æ–‡ä»¶è¯»å–ï¼Œè€Œæ˜¯ä¸€ä¸ª**ä¸‰å±‚æ¶æ„çš„åŠ¨æ€é…ç½®ç³»ç»Ÿ**ã€‚

```
ç®€å•ç†è§£ï¼š
ä¼ ç»Ÿæ•°æ®åº“ï¼šä¿®æ”¹é…ç½® â†’ é‡å¯æœåŠ¡ â†’ é…ç½®ç”Ÿæ•ˆ
ProxySQLï¼šä¿®æ”¹é…ç½® â†’ åŠ¨æ€åŠ è½½ â†’ ç«‹å³ç”Ÿæ•ˆï¼ˆæ— éœ€é‡å¯ï¼‰
```

**ğŸ”¸ æ ¸å¿ƒè®¾è®¡ç†å¿µ**
```
é«˜å¯ç”¨åŸåˆ™ï¼šé…ç½®å˜æ›´ä¸å½±å“æœåŠ¡è¿è¡Œ
åˆ†å±‚ç®¡ç†ï¼šä¸åŒå±‚æ¬¡çš„é…ç½®æœ‰ä¸åŒä½œç”¨
ç‰ˆæœ¬æ§åˆ¶ï¼šé…ç½®å˜æ›´å¯è¿½æº¯ã€å¯å›æ»š
å®æ—¶ç”Ÿæ•ˆï¼šé…ç½®ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆ
```

### 1.2 é…ç½®ä½“ç³»çš„æ ¸å¿ƒç‰¹ç‚¹


| ç‰¹ç‚¹ | **ä¼ ç»Ÿé…ç½®** | **ProxySQLé…ç½®** | **ä¼˜åŠ¿** |
|------|-------------|-----------------|----------|
| ğŸ”„ **ç”Ÿæ•ˆæ–¹å¼** | `é‡å¯æœåŠ¡` | `åŠ¨æ€åŠ è½½` | `é›¶åœæœºé…ç½®å˜æ›´` |
| ğŸ“‚ **å­˜å‚¨æ–¹å¼** | `å•ä¸€æ–‡ä»¶` | `ä¸‰å±‚å­˜å‚¨` | `é…ç½®éš”ç¦»å’Œå®‰å…¨` |
| ğŸ” **ç®¡ç†æ–¹å¼** | `æ‰‹åŠ¨ç¼–è¾‘` | `SQLæ¥å£` | `ç¨‹åºåŒ–ç®¡ç†` |
| ğŸ“Š **ç‰ˆæœ¬æ§åˆ¶** | `æ‰‹åŠ¨å¤‡ä»½` | `å†…ç½®ç‰ˆæœ¬` | `è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†` |

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·çš„é…ç½®ä½“ç³»


**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**
```
é—®é¢˜1ï¼šä¼ ç»Ÿé…ç½®ä¿®æ”¹éœ€è¦é‡å¯
è§£å†³ï¼šä¸‰å±‚é…ç½®ä½“ç³»å®ç°çƒ­æ›´æ–°

é—®é¢˜2ï¼šé…ç½®é”™è¯¯å¯¼è‡´æœåŠ¡ä¸å¯ç”¨
è§£å†³ï¼šé…ç½®éªŒè¯å’Œå›æ»šæœºåˆ¶

é—®é¢˜3ï¼šå¤šç¯å¢ƒé…ç½®ç®¡ç†å¤æ‚
è§£å†³ï¼šç»Ÿä¸€çš„SQLæ¥å£ç®¡ç†

é—®é¢˜4ï¼šé…ç½®å˜æ›´ç¼ºä¹ç‰ˆæœ¬æ§åˆ¶
è§£å†³ï¼šå†…ç½®é…ç½®ç‰ˆæœ¬ç®¡ç†
```

---

## 2. ğŸ“‹ é…ç½®æ–‡ä»¶ç»“æ„è¯¦è§£


### 2.1 ä¸»é…ç½®æ–‡ä»¶ç»“æ„


ProxySQLçš„é…ç½®æ–‡ä»¶é‡‡ç”¨**ç±»ä¼¼MySQLçš„é…ç½®æ ¼å¼**ï¼Œä½†åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚

```ini
# /etc/proxysql.cnf - ProxySQLä¸»é…ç½®æ–‡ä»¶

# ===============================
# æ•°æ®ç›®å½•é…ç½® - ProxySQLå­˜å‚¨æ•°æ®çš„ä½ç½®
# ===============================
datadir="/var/lib/proxysql"

# ===============================
# Adminç®¡ç†æ¥å£é…ç½®
# ===============================
admin_variables={
    admin_credentials="admin:admin;radmin:radmin"  # ç®¡ç†å‘˜è´¦å·
    mysql_ifaces="0.0.0.0:6032"                   # ç®¡ç†æ¥å£åœ°å€
    refresh_interval=2000                          # åˆ·æ–°é—´éš”(æ¯«ç§’)
}

# ===============================
# MySQLä»£ç†æ¥å£é…ç½®  
# ===============================
mysql_variables={
    threads=4                                      # å·¥ä½œçº¿ç¨‹æ•°
    max_connections=2048                           # æœ€å¤§è¿æ¥æ•°
    default_query_delay=0                          # æŸ¥è¯¢å»¶è¿Ÿ
    default_query_timeout=36000000                 # æŸ¥è¯¢è¶…æ—¶
    interfaces="0.0.0.0:6033"                     # ä»£ç†æ¥å£åœ°å€
}
```

### 2.2 é…ç½®æ–‡ä»¶æ ¸å¿ƒèŠ‚ç‚¹è§£æ


**ğŸ”¸ æ•°æ®ç›®å½•é…ç½®**
```ini
datadir="/var/lib/proxysql"

å«ä¹‰è§£é‡Šï¼š
- ProxySQLçš„å·¥ä½œç›®å½•
- å­˜å‚¨é…ç½®æ•°æ®åº“ã€æ—¥å¿—æ–‡ä»¶
- ç±»ä¼¼MySQLçš„datadiræ¦‚å¿µ
```

**ğŸ”¸ Adminæ¥å£é…ç½®**
```ini
admin_variables={
    admin_credentials="admin:admin"     # ç”¨æˆ·å:å¯†ç 
    mysql_ifaces="0.0.0.0:6032"        # ç›‘å¬IP:ç«¯å£
    refresh_interval=2000               # é…ç½®æ£€æŸ¥é—´éš”
}

é€šä¿—ç†è§£ï¼š
admin_credentials â†’ ç®¡ç†å‘˜çš„è´¦å·å¯†ç 
mysql_ifaces â†’ ç®¡ç†æ¥å£åœ¨å“ªä¸ªåœ°å€ç›‘å¬
refresh_interval â†’ å¤šä¹…æ£€æŸ¥ä¸€æ¬¡é…ç½®å˜åŒ–
```

**ğŸ”¸ MySQLä»£ç†é…ç½®**
```ini
mysql_variables={
    threads=4                          # å¤„ç†è¯·æ±‚çš„å·¥ä½œçº¿ç¨‹
    max_connections=2048               # åŒæ—¶æ”¯æŒå¤šå°‘å®¢æˆ·ç«¯è¿æ¥
    interfaces="0.0.0.0:6033"         # å®¢æˆ·ç«¯è¿æ¥çš„åœ°å€
}

å®é™…å«ä¹‰ï¼š
threads â†’ å¼€å‡ ä¸ªå·¥äººæ¥å¤„ç†è¯·æ±‚
max_connections â†’ æœ€å¤šæœåŠ¡å¤šå°‘å®¢æˆ·
interfaces â†’ å®¢æˆ·ä»å“ªä¸ªé—¨è¿›æ¥
```

### 2.3 é…ç½®æ–‡ä»¶çš„å±‚æ¬¡ç»“æ„


```
ProxySQLé…ç½®æ–‡ä»¶ç»“æ„å›¾ï¼š

proxysql.cnf (ä¸»é…ç½®æ–‡ä»¶)
â”œâ”€â”€ datadir (æ•°æ®ç›®å½•)
â”œâ”€â”€ admin_variables (ç®¡ç†é…ç½®)
â”‚   â”œâ”€â”€ admin_credentials (ç®¡ç†å‘˜è´¦å·)
â”‚   â”œâ”€â”€ mysql_ifaces (ç®¡ç†æ¥å£)
â”‚   â””â”€â”€ refresh_interval (åˆ·æ–°é—´éš”)
â”œâ”€â”€ mysql_variables (ä»£ç†é…ç½®)
â”‚   â”œâ”€â”€ threads (å·¥ä½œçº¿ç¨‹)
â”‚   â”œâ”€â”€ max_connections (æœ€å¤§è¿æ¥)
â”‚   â””â”€â”€ interfaces (ä»£ç†æ¥å£)
â””â”€â”€ mysql_servers (åç«¯æœåŠ¡å™¨é…ç½®)
    â”œâ”€â”€ hostgroup_id (æœåŠ¡å™¨ç»„)
    â”œâ”€â”€ hostname (æœåŠ¡å™¨åœ°å€)
    â””â”€â”€ port (æœåŠ¡å™¨ç«¯å£)
```

---

## 3. âš–ï¸ å¤šå±‚é…ç½®ä½“ç³»


### 3.1 ä¸‰å±‚é…ç½®æ¶æ„è¯¦è§£


ProxySQLé‡‡ç”¨**ä¸‰å±‚é…ç½®æ¶æ„**ï¼Œè¿™æ˜¯å®ƒæœ€æ ¸å¿ƒçš„ç‰¹æ€§ä¹‹ä¸€ã€‚

```
é…ç½®å±‚æ¬¡ç»“æ„å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    RUNTIME      â”‚ â† è¿è¡Œæ—¶é…ç½®ï¼ˆå½“å‰ç”Ÿæ•ˆï¼‰
â”‚   (è¿è¡Œæ—¶å±‚)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    MEMORY       â”‚ â† å†…å­˜é…ç½®ï¼ˆå¾…ç”Ÿæ•ˆï¼‰
â”‚   (å†…å­˜å±‚)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     DISK        â”‚ â† ç£ç›˜é…ç½®ï¼ˆæŒä¹…åŒ–ï¼‰
â”‚   (ç£ç›˜å±‚)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å„å±‚é…ç½®çš„ä½œç”¨å’Œç‰¹ç‚¹


| é…ç½®å±‚ | **ä½œç”¨** | **ç‰¹ç‚¹** | **ä½¿ç”¨åœºæ™¯** |
|--------|---------|---------|-------------|
| ğŸ”„ **RUNTIME** | `å½“å‰ç”Ÿæ•ˆçš„é…ç½®` | `åªè¯»ï¼Œå®é™…è¿è¡Œ` | `æŸ¥çœ‹å½“å‰é…ç½®çŠ¶æ€` |
| ğŸ’¾ **MEMORY** | `å‡†å¤‡ç”Ÿæ•ˆçš„é…ç½®` | `å¯è¯»å†™ï¼Œä¸´æ—¶å­˜å‚¨` | `ä¿®æ”¹å’Œæµ‹è¯•é…ç½®` |
| ğŸ’¿ **DISK** | `æŒä¹…åŒ–çš„é…ç½®` | `å¯è¯»å†™ï¼Œæ°¸ä¹…ä¿å­˜` | `é…ç½®å¤‡ä»½å’Œæ¢å¤` |

### 3.3 é…ç½®æµè½¬æœºåˆ¶è¯¦è§£


**ğŸ”¸ é…ç½®ä¿®æ”¹çš„å®Œæ•´æµç¨‹**
```
é…ç½®ä¿®æ”¹æµç¨‹å›¾ï¼š

ç”¨æˆ·ä¿®æ”¹ â†’ MEMORY â†’ éªŒè¯é€šè¿‡ â†’ RUNTIME â†’ è¿è¡Œç”Ÿæ•ˆ
    â†“                              â†“
DISKå±‚ä¿å­˜ â†â”€â”€â”€â”€â”€â”€ æŒä¹…åŒ– â†â”€â”€â”€â”€â”€â”€ é…ç½®ç¡®è®¤
```

**å…·ä½“æ“ä½œæ­¥éª¤ï¼š**
```sql
-- æ­¥éª¤1ï¼šä¿®æ”¹MEMORYå±‚é…ç½®
INSERT INTO mysql_servers(hostgroup_id, hostname, port) 
VALUES (0, '192.168.1.100', 3306);

-- æ­¥éª¤2ï¼šåŠ è½½åˆ°RUNTIMEå±‚ï¼ˆé…ç½®ç”Ÿæ•ˆï¼‰
LOAD MYSQL SERVERS TO RUNTIME;

-- æ­¥éª¤3ï¼šä¿å­˜åˆ°DISKå±‚ï¼ˆæŒä¹…åŒ–ï¼‰
SAVE MYSQL SERVERS TO DISK;
```

### 3.4 ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸‰å±‚æ¶æ„


**ğŸ¯ è®¾è®¡ç†ç”±å’Œä¼˜åŠ¿**
```
å®‰å…¨æ€§è€ƒè™‘ï¼š
- MEMORYå±‚ä½œä¸ºç¼“å†²ï¼Œé¿å…é”™è¯¯é…ç½®ç›´æ¥ç”Ÿæ•ˆ
- å¯ä»¥åœ¨MEMORYå±‚æµ‹è¯•é…ç½®æ­£ç¡®æ€§

çµæ´»æ€§è€ƒè™‘ï¼š
- å¯ä»¥æ‰¹é‡ä¿®æ”¹é…ç½®åä¸€æ¬¡æ€§ç”Ÿæ•ˆ
- æ”¯æŒé…ç½®å›æ»šå’Œç‰ˆæœ¬ç®¡ç†

æ€§èƒ½è€ƒè™‘ï¼š
- RUNTIMEå±‚åªè¯»ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
- é…ç½®å˜æ›´ä¸å½±å“æ­£åœ¨è¿è¡Œçš„æœåŠ¡
```

---

## 4. ğŸ”„ åŠ¨æ€é…ç½®ç®¡ç†


### 4.1 ä»€ä¹ˆæ˜¯åŠ¨æ€é…ç½®åŠ è½½


åŠ¨æ€é…ç½®åŠ è½½å°±æ˜¯**ä¸é‡å¯æœåŠ¡å°±èƒ½è®©æ–°é…ç½®ç”Ÿæ•ˆ**çš„èƒ½åŠ›ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
ä¿®æ”¹é…ç½®æ–‡ä»¶ â†’ é‡å¯æœåŠ¡ â†’ æœåŠ¡ä¸­æ–­ â†’ é…ç½®ç”Ÿæ•ˆ

ProxySQLæ–¹å¼ï¼š
ä¿®æ”¹MEMORYé…ç½® â†’ LOAD TO RUNTIME â†’ é…ç½®ç«‹å³ç”Ÿæ•ˆ â†’ æœåŠ¡ä¸ä¸­æ–­
```

### 4.2 åŠ¨æ€é…ç½®çš„æ ¸å¿ƒå‘½ä»¤


**ğŸ”¸ é…ç½®åŠ è½½å‘½ä»¤è¯¦è§£**

| å‘½ä»¤ | **ä½œç”¨** | **ä½¿ç”¨åœºæ™¯** |
|------|---------|-------------|
| `LOAD ... TO RUNTIME` | `ä½¿é…ç½®ç«‹å³ç”Ÿæ•ˆ` | `é…ç½®ä¿®æ”¹åç”Ÿæ•ˆ` |
| `SAVE ... TO DISK` | `é…ç½®æŒä¹…åŒ–ä¿å­˜` | `ç¡®è®¤é…ç½®æ°¸ä¹…ä¿å­˜` |
| `LOAD ... FROM DISK` | `ä»ç£ç›˜æ¢å¤é…ç½®` | `é…ç½®å›æ»š` |

### 4.3 å…·ä½“é…ç½®é¡¹çš„åŠ¨æ€ç®¡ç†


**ğŸ”¸ æœåŠ¡å™¨é…ç½®åŠ¨æ€ç®¡ç†**
```sql
-- 1. æ·»åŠ æ–°çš„MySQLæœåŠ¡å™¨
INSERT INTO mysql_servers(hostgroup_id, hostname, port, weight) 
VALUES (0, '192.168.1.101', 3306, 1000);

-- 2. ç«‹å³ç”Ÿæ•ˆ
LOAD MYSQL SERVERS TO RUNTIME;

-- 3. æŒä¹…åŒ–ä¿å­˜
SAVE MYSQL SERVERS TO DISK;

-- éªŒè¯é…ç½®ï¼šæŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„æœåŠ¡å™¨
SELECT * FROM runtime_mysql_servers;
```

**ğŸ”¸ ç”¨æˆ·é…ç½®åŠ¨æ€ç®¡ç†**
```sql
-- 1. æ·»åŠ æ–°ç”¨æˆ·
INSERT INTO mysql_users(username, password, default_hostgroup) 
VALUES ('newuser', 'password123', 0);

-- 2. ä½¿ç”¨æˆ·é…ç½®ç”Ÿæ•ˆ
LOAD MYSQL USERS TO RUNTIME;

-- 3. ä¿å­˜ç”¨æˆ·é…ç½®
SAVE MYSQL USERS TO DISK;
```

### 4.4 é…ç½®éªŒè¯æœºåˆ¶


ProxySQLåœ¨é…ç½®ç”Ÿæ•ˆå‰ä¼šè¿›è¡Œ**è‡ªåŠ¨éªŒè¯**ï¼š

```sql
-- éªŒè¯é…ç½®çš„æ–¹æ³•
-- 1. æ£€æŸ¥MEMORYå±‚é…ç½®è¯­æ³•
SELECT * FROM mysql_servers WHERE hostgroup_id = 0;

-- 2. å°è¯•åŠ è½½åˆ°RUNTIMEï¼ˆå¦‚æœå¤±è´¥ä¼šæœ‰é”™è¯¯æç¤ºï¼‰
LOAD MYSQL SERVERS TO RUNTIME;

-- 3. æŸ¥çœ‹åŠ è½½ç»“æœ
SHOW WARNINGS;
```

**âš ï¸ é…ç½®éªŒè¯å¤±è´¥çš„å¤„ç†**
```
éªŒè¯å¤±è´¥æƒ…å†µï¼š
- æœåŠ¡å™¨åœ°å€ä¸å¯è¾¾
- ç«¯å£é…ç½®é”™è¯¯  
- ç”¨æˆ·æƒé™ä¸è¶³

å¤„ç†æ–¹å¼ï¼š
- ä¿®æ”¹MEMORYå±‚é…ç½®
- é‡æ–°éªŒè¯
- ç¡®è®¤æ— è¯¯åå†åŠ è½½
```

---

## 5. ğŸ› ï¸ Adminæ¥å£é…ç½®æ“ä½œ


### 5.1 Adminæ¥å£æ¦‚è¿°


Adminæ¥å£æ˜¯ProxySQLçš„**ç®¡ç†æ§åˆ¶å°**ï¼Œå°±åƒMySQLçš„å‘½ä»¤è¡Œä¸€æ ·ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚

```
è¿æ¥Adminæ¥å£ï¼š
mysql -u admin -padmin -h 127.0.0.1 -P 6032 --prompt='Admin> '

ä½œç”¨ï¼š
- æŸ¥çœ‹å’Œä¿®æ”¹é…ç½®
- ç›‘æ§è¿è¡ŒçŠ¶æ€  
- ç®¡ç†ç”¨æˆ·å’ŒæœåŠ¡å™¨
- æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
```

### 5.2 æ ¸å¿ƒé…ç½®è¡¨è¯´æ˜


**ğŸ”¸ ä¸»è¦é…ç½®è¡¨åŠå…¶ä½œç”¨**

| é…ç½®è¡¨ | **ä½œç”¨** | **å…³é”®å­—æ®µ** |
|--------|---------|-------------|
| `mysql_servers` | `åç«¯MySQLæœåŠ¡å™¨é…ç½®` | `hostgroup_id, hostname, port` |
| `mysql_users` | `å®¢æˆ·ç«¯ç”¨æˆ·é…ç½®` | `username, password, default_hostgroup` |
| `mysql_query_rules` | `æŸ¥è¯¢è·¯ç”±è§„åˆ™` | `rule_id, match_pattern, destination_hostgroup` |
| `global_variables` | `å…¨å±€å‚æ•°é…ç½®` | `variable_name, variable_value` |

### 5.3 é…ç½®è¡¨çš„æ“ä½œå®ä¾‹


**ğŸ”¸ æœåŠ¡å™¨é…ç½®ç®¡ç†**
```sql
-- æŸ¥çœ‹å½“å‰æœåŠ¡å™¨é…ç½®
SELECT hostgroup_id, hostname, port, status, weight 
FROM mysql_servers ORDER BY hostgroup_id;

-- æ·»åŠ ä¸»åº“æœåŠ¡å™¨
INSERT INTO mysql_servers(hostgroup_id, hostname, port, weight, comment) 
VALUES (0, '192.168.1.100', 3306, 1000, 'Master Server');

-- æ·»åŠ ä»åº“æœåŠ¡å™¨
INSERT INTO mysql_servers(hostgroup_id, hostname, port, weight, comment) 
VALUES (1, '192.168.1.101', 3306, 900, 'Slave Server 1');

-- ç”Ÿæ•ˆé…ç½®
LOAD MYSQL SERVERS TO RUNTIME;
SAVE MYSQL SERVERS TO DISK;
```

**ğŸ”¸ ç”¨æˆ·æƒé™é…ç½®**
```sql
-- æŸ¥çœ‹ç”¨æˆ·é…ç½®
SELECT username, default_hostgroup, max_connections 
FROM mysql_users;

-- é…ç½®åº”ç”¨ç”¨æˆ·
INSERT INTO mysql_users(username, password, default_hostgroup, max_connections) 
VALUES ('app_user', 'app_pass', 0, 200);

-- é…ç½®åªè¯»ç”¨æˆ·
INSERT INTO mysql_users(username, password, default_hostgroup) 
VALUES ('readonly_user', 'readonly_pass', 1);

-- åº”ç”¨ç”¨æˆ·é…ç½®
LOAD MYSQL USERS TO RUNTIME;
SAVE MYSQL USERS TO DISK;
```

### 5.4 å…¨å±€å˜é‡é…ç½®


**ğŸ”¸ é‡è¦å…¨å±€å˜é‡è®¾ç½®**
```sql
-- æŸ¥çœ‹æ‰€æœ‰å…¨å±€å˜é‡
SELECT variable_name, variable_value FROM global_variables 
WHERE variable_name LIKE 'mysql%' ORDER BY variable_name;

-- è®¾ç½®è¿æ¥è¶…æ—¶
UPDATE global_variables SET variable_value='28800' 
WHERE variable_name='mysql-default_query_timeout';

-- è®¾ç½®æœ€å¤§è¿æ¥æ•°
UPDATE global_variables SET variable_value='4096' 
WHERE variable_name='mysql-max_connections';

-- åº”ç”¨å…¨å±€å˜é‡
LOAD MYSQL VARIABLES TO RUNTIME;
SAVE MYSQL VARIABLES TO DISK;
```

---

## 6. ğŸ’¾ é…ç½®æŒä¹…åŒ–ä¸ç‰ˆæœ¬ç®¡ç†


### 6.1 é…ç½®æŒä¹…åŒ–æœºåˆ¶


é…ç½®æŒä¹…åŒ–å°±æ˜¯æŠŠ**å†…å­˜ä¸­çš„é…ç½®æ°¸ä¹…ä¿å­˜åˆ°ç£ç›˜**ï¼Œç¡®ä¿é‡å¯åé…ç½®ä¸ä¸¢å¤±ã€‚

```
æŒä¹…åŒ–æµç¨‹å›¾ï¼š

MEMORYé…ç½® â†’ LOAD TO RUNTIME â†’ é…ç½®ç”Ÿæ•ˆ
    â†“
SAVE TO DISK â†’ ç£ç›˜æ–‡ä»¶ â†’ é‡å¯åè‡ªåŠ¨åŠ è½½
```

### 6.2 æŒä¹…åŒ–æ“ä½œè¯¦è§£


**ğŸ”¸ å„ç±»é…ç½®çš„æŒä¹…åŒ–å‘½ä»¤**
```sql
-- æœåŠ¡å™¨é…ç½®æŒä¹…åŒ–
SAVE MYSQL SERVERS TO DISK;

-- ç”¨æˆ·é…ç½®æŒä¹…åŒ–  
SAVE MYSQL USERS TO DISK;

-- æŸ¥è¯¢è§„åˆ™æŒä¹…åŒ–
SAVE MYSQL QUERY RULES TO DISK;

-- å…¨å±€å˜é‡æŒä¹…åŒ–
SAVE MYSQL VARIABLES TO DISK;

-- ä¸€æ¬¡æ€§ä¿å­˜æ‰€æœ‰é…ç½®
SAVE MYSQL SERVERS TO DISK;
SAVE MYSQL USERS TO DISK;
SAVE MYSQL QUERY RULES TO DISK;
SAVE MYSQL VARIABLES TO DISK;
```

### 6.3 é…ç½®ç‰ˆæœ¬ç®¡ç†


**ğŸ”¸ é…ç½®å¿«ç…§æœºåˆ¶**
```sql
-- æŸ¥çœ‹é…ç½®ç‰ˆæœ¬ä¿¡æ¯
SELECT * FROM stats_mysql_global WHERE variable_name LIKE '%version%';

-- æŸ¥çœ‹é…ç½®å˜æ›´å†å²ï¼ˆéœ€è¦å¼€å¯æ—¥å¿—ï¼‰
SELECT * FROM stats_mysql_commands_counters 
WHERE command LIKE '%LOAD%' OR command LIKE '%SAVE%';
```

### 6.4 é…ç½®å¤‡ä»½ä¸æ¢å¤


**ğŸ”¸ æ‰‹åŠ¨å¤‡ä»½é…ç½®**
```bash
# 1. å¤‡ä»½ProxySQLæ•°æ®åº“æ–‡ä»¶
cp /var/lib/proxysql/proxysql.db /backup/proxysql_$(date +%Y%m%d).db

# 2. å¤‡ä»½é…ç½®æ–‡ä»¶
cp /etc/proxysql.cnf /backup/proxysql_$(date +%Y%m%d).cnf
```

**ğŸ”¸ é…ç½®æ¢å¤æ“ä½œ**
```sql
-- ä»DISKæ¢å¤åˆ°MEMORY
LOAD MYSQL SERVERS FROM DISK;
LOAD MYSQL USERS FROM DISK;

-- å†ä»MEMORYåŠ è½½åˆ°RUNTIME
LOAD MYSQL SERVERS TO RUNTIME;
LOAD MYSQL USERS TO RUNTIME;
```

---

## 7. ğŸª å®æˆ˜é…ç½®æ¡ˆä¾‹


### 7.1 å®Œæ•´çš„ä¸»ä»æ¶æ„é…ç½®


**åœºæ™¯æè¿°ï¼š** é…ç½®1ä¸»2ä»çš„MySQLé›†ç¾¤ä»£ç†

```sql
-- === æ­¥éª¤1ï¼šé…ç½®åç«¯MySQLæœåŠ¡å™¨ ===
-- ä¸»åº“æœåŠ¡å™¨ï¼ˆå†™æ“ä½œï¼‰
INSERT INTO mysql_servers(hostgroup_id, hostname, port, weight, comment) VALUES 
(0, '192.168.1.100', 3306, 1000, 'Master - Write Group');

-- ä»åº“æœåŠ¡å™¨ï¼ˆè¯»æ“ä½œï¼‰
INSERT INTO mysql_servers(hostgroup_id, hostname, port, weight, comment) VALUES 
(1, '192.168.1.101', 3306, 900, 'Slave1 - Read Group'),
(1, '192.168.1.102', 3306, 900, 'Slave2 - Read Group');

-- === æ­¥éª¤2ï¼šé…ç½®ç”¨æˆ·æƒé™ ===
-- åº”ç”¨è¯»å†™ç”¨æˆ·
INSERT INTO mysql_users(username, password, default_hostgroup, max_connections) VALUES 
('app_user', 'app_password', 0, 200);

-- åªè¯»ç”¨æˆ·
INSERT INTO mysql_users(username, password, default_hostgroup, max_connections) VALUES 
('readonly_user', 'readonly_password', 1, 100);

-- === æ­¥éª¤3ï¼šé…ç½®æŸ¥è¯¢è·¯ç”±è§„åˆ™ ===
-- SELECTæŸ¥è¯¢è·¯ç”±åˆ°ä»åº“
INSERT INTO mysql_query_rules(rule_id, match_pattern, destination_hostgroup, apply) VALUES 
(1, '^SELECT.*', 1, 1);

-- å†™æ“ä½œè·¯ç”±åˆ°ä¸»åº“
INSERT INTO mysql_query_rules(rule_id, match_pattern, destination_hostgroup, apply) VALUES 
(2, '^(INSERT|UPDATE|DELETE).*', 0, 1);

-- === æ­¥éª¤4ï¼šåº”ç”¨æ‰€æœ‰é…ç½® ===
LOAD MYSQL SERVERS TO RUNTIME;
LOAD MYSQL USERS TO RUNTIME;  
LOAD MYSQL QUERY RULES TO RUNTIME;

-- === æ­¥éª¤5ï¼šæŒä¹…åŒ–ä¿å­˜ ===
SAVE MYSQL SERVERS TO DISK;
SAVE MYSQL USERS TO DISK;
SAVE MYSQL QUERY RULES TO DISK;
```

### 7.2 é…ç½®éªŒè¯å’Œæµ‹è¯•


```sql
-- éªŒè¯æœåŠ¡å™¨é…ç½®
SELECT hostgroup_id, hostname, port, status, ConnUsed, ConnFree 
FROM runtime_mysql_servers;

-- éªŒè¯ç”¨æˆ·é…ç½®
SELECT username, default_hostgroup, max_connections 
FROM runtime_mysql_users;

-- éªŒè¯è·¯ç”±è§„åˆ™
SELECT rule_id, match_pattern, destination_hostgroup 
FROM runtime_mysql_query_rules WHERE active=1;

-- æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
SELECT * FROM stats_mysql_connection_pool;
```

### 7.3 å¸¸è§é…ç½®è°ƒä¼˜


**ğŸ”¸ è¿æ¥æ± ä¼˜åŒ–**
```sql
-- å¢åŠ è¿æ¥æ± å¤§å°
UPDATE global_variables SET variable_value='500' 
WHERE variable_name='mysql-default_max_connections';

-- è°ƒæ•´è¿æ¥è¶…æ—¶
UPDATE global_variables SET variable_value='3600' 
WHERE variable_name='mysql-wait_timeout';

-- åº”ç”¨é…ç½®
LOAD MYSQL VARIABLES TO RUNTIME;
SAVE MYSQL VARIABLES TO DISK;
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¸‰å±‚é…ç½®æ¶æ„ï¼šRUNTIMEï¼ˆç”Ÿæ•ˆï¼‰â†’ MEMORYï¼ˆä¿®æ”¹ï¼‰â†’ DISKï¼ˆæŒä¹…åŒ–ï¼‰
ğŸ”¸ åŠ¨æ€é…ç½®åŠ è½½ï¼šLOAD TO RUNTIME ä½¿é…ç½®ç«‹å³ç”Ÿæ•ˆ
ğŸ”¸ é…ç½®æŒä¹…åŒ–ï¼šSAVE TO DISK æ°¸ä¹…ä¿å­˜é…ç½®
ğŸ”¸ Adminæ¥å£ï¼šé€šè¿‡SQLæ–¹å¼ç®¡ç†æ‰€æœ‰é…ç½®
ğŸ”¸ é…ç½®éªŒè¯ï¼šè‡ªåŠ¨éªŒè¯é…ç½®æ­£ç¡®æ€§ï¼Œé¿å…é”™è¯¯é…ç½®
```

### 8.2 é…ç½®æ“ä½œæ ¸å¿ƒæµç¨‹


**ğŸ”¹ æ ‡å‡†é…ç½®æµç¨‹**
```
1. ä¿®æ”¹MEMORYå±‚é…ç½® â†’ INSERT/UPDATEé…ç½®è¡¨
2. éªŒè¯é…ç½®æ­£ç¡®æ€§ â†’ æ£€æŸ¥è¯­æ³•å’Œè¿é€šæ€§
3. åŠ è½½åˆ°RUNTIME â†’ LOAD TO RUNTIME
4. æŒä¹…åŒ–ä¿å­˜ â†’ SAVE TO DISK
5. éªŒè¯ç”Ÿæ•ˆç»“æœ â†’ æŸ¥çœ‹runtimeè¡¨
```

### 8.3 å®é™…åº”ç”¨è¦ç‚¹


**ğŸ”¹ é…ç½®æœ€ä½³å®è·µ**
- **å…ˆæµ‹è¯•åç”Ÿæ•ˆ**ï¼šåœ¨MEMORYå±‚å……åˆ†æµ‹è¯•é…ç½®
- **æ‰¹é‡æ“ä½œ**ï¼šå¤šä¸ªé…ç½®ä¿®æ”¹åä¸€æ¬¡æ€§åŠ è½½
- **åŠæ—¶æŒä¹…åŒ–**ï¼šç¡®è®¤é…ç½®æ­£ç¡®åç«‹å³ä¿å­˜åˆ°ç£ç›˜
- **å®šæœŸå¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½ProxySQLæ•°æ®åº“æ–‡ä»¶

**ğŸ”¹ å¸¸è§é—®é¢˜å¤„ç†**
- **é…ç½®ä¸ç”Ÿæ•ˆ**ï¼šæ£€æŸ¥æ˜¯å¦æ‰§è¡Œäº†LOAD TO RUNTIME
- **é‡å¯åé…ç½®ä¸¢å¤±**ï¼šæ£€æŸ¥æ˜¯å¦æ‰§è¡Œäº†SAVE TO DISK
- **è¿æ¥å¤±è´¥**ï¼šéªŒè¯æœåŠ¡å™¨åœ°å€å’Œç«¯å£é…ç½®
- **æƒé™é”™è¯¯**ï¼šæ£€æŸ¥ç”¨æˆ·é…ç½®å’Œå¯†ç è®¾ç½®

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ä¸‰å±‚é…ç½®è¦è®°ç‰¢ï¼ŒMEMORYä¿®æ”¹RUNTIMEè·‘
- é…ç½®ç”Ÿæ•ˆé LOADï¼ŒæŒä¹…ä¿å­˜è¦SAVEå¥½
- Adminæ¥å£åŠŸèƒ½å¼ºï¼ŒSQLç®¡ç†é…ç½®æ£’
- åŠ¨æ€é…ç½®ä¸é‡å¯ï¼Œé«˜å¯ç”¨æ€§ç¬¬ä¸€ä½