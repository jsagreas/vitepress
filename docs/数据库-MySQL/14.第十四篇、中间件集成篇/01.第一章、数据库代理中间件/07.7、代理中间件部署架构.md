---
title: 7ã€ä»£ç†ä¸­é—´ä»¶éƒ¨ç½²æ¶æ„
---
## ğŸ“š ç›®å½•

1. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¦‚è¿°](#1-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¦‚è¿°)
2. [é«˜å¯ç”¨æ¶æ„è®¾è®¡](#2-é«˜å¯ç”¨æ¶æ„è®¾è®¡)
3. [æœåŠ¡å‘ç°ä¸æ³¨å†Œ](#3-æœåŠ¡å‘ç°ä¸æ³¨å†Œ)
4. [è´Ÿè½½å‡è¡¡ç­–ç•¥](#4-è´Ÿè½½å‡è¡¡ç­–ç•¥)
5. [å®¹å™¨åŒ–éƒ¨ç½²å®è·µ](#5-å®¹å™¨åŒ–éƒ¨ç½²å®è·µ)
6. [ç›‘æ§å‘Šè­¦ä½“ç³»](#6-ç›‘æ§å‘Šè­¦ä½“ç³»)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†ä¸­é—´ä»¶


**ç®€å•ç†è§£**ï¼šæ•°æ®åº“ä»£ç†ä¸­é—´ä»¶å°±åƒæ˜¯åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ä¹‹é—´çš„"ç¿»è¯‘å®˜"å’Œ"ç®¡å®¶"ã€‚

```
åº”ç”¨ç¨‹åº â†’ ä»£ç†ä¸­é—´ä»¶ â†’ æ•°æ®åº“é›†ç¾¤
   â†‘         â†‘           â†‘
 å‘è¯·æ±‚    æ™ºèƒ½è·¯ç”±     çœŸæ­£å­˜å‚¨
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **è¯»å†™åˆ†ç¦»**ï¼šè‡ªåŠ¨æŠŠè¯»è¯·æ±‚å‘ç»™ä»åº“ï¼Œå†™è¯·æ±‚å‘ç»™ä¸»åº“
- **è´Ÿè½½å‡è¡¡**ï¼šæŠŠè¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“æœåŠ¡å™¨
- **è¿æ¥æ± ç®¡ç†**ï¼šå¤ç”¨æ•°æ®åº“è¿æ¥ï¼Œæé«˜æ€§èƒ½
- **æ•…éšœåˆ‡æ¢**ï¼šæŸä¸ªæ•°æ®åº“æŒ‚äº†è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨åº“

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†ä¸­é—´ä»¶


**ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**ï¼š
```java
// åº”ç”¨ç›´è¿æ•°æ®åº“çš„é—®é¢˜
DataSource masterDs = new DataSource("192.168.1.100:3306");
DataSource slaveDs = new DataSource("192.168.1.101:3306");

// ä»£ç é‡Œè¦è‡ªå·±åˆ¤æ–­è¯»å†™
if (isReadOperation()) {
    return slaveDs.getConnection(); // æ‰‹åŠ¨é€‰æ‹©ä»åº“
} else {
    return masterDs.getConnection(); // æ‰‹åŠ¨é€‰æ‹©ä¸»åº“
}
```

**å­˜åœ¨çš„é—®é¢˜**ï¼š
- ğŸ”´ **ä»£ç å¤æ‚**ï¼šæ¯ä¸ªåº”ç”¨éƒ½è¦å†™è¯»å†™åˆ†ç¦»é€»è¾‘
- ğŸ”´ **ç»´æŠ¤å›°éš¾**ï¼šæ•°æ®åº“åœ°å€å˜äº†è¦æ”¹æ‰€æœ‰åº”ç”¨
- ğŸ”´ **æ•…éšœå¤„ç†**ï¼šæ•°æ®åº“æŒ‚äº†åº”ç”¨ä¸çŸ¥é“æ€ä¹ˆåŠ

**ä½¿ç”¨ä»£ç†ä¸­é—´ä»¶å**ï¼š
```java
// åº”ç”¨åªéœ€è¦è¿ä¸€ä¸ªåœ°å€
DataSource proxyDs = new DataSource("proxy.company.com:3306");
Connection conn = proxyDs.getConnection();

// ä»£ç†ä¸­é—´ä»¶è‡ªåŠ¨å¤„ç†ä¸€åˆ‡
conn.executeQuery("SELECT * FROM users"); // è‡ªåŠ¨è·¯ç”±åˆ°ä»åº“
conn.executeUpdate("UPDATE users SET ..."); // è‡ªåŠ¨è·¯ç”±åˆ°ä¸»åº“
```

### 1.3 å¸¸è§çš„ä»£ç†ä¸­é—´ä»¶


| ä¸­é—´ä»¶åç§° | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|------------|----------|-------------|-----------|
| ğŸ”¹ **MyCat** | `å›½äº§å¼€æºï¼ŒåŠŸèƒ½ä¸°å¯Œ` | `ä¸­å¤§å‹é¡¹ç›®` | `åŠŸèƒ½å¼ºå¤§ä½†é…ç½®å¤æ‚` |
| ğŸ”¹ **Sharding-Proxy** | `åˆ†åº“åˆ†è¡¨ä¸“ä¸š` | `æµ·é‡æ•°æ®åœºæ™¯` | `ä¸“æ³¨åˆ†ç‰‡ï¼Œå…¶ä»–åŠŸèƒ½è¾ƒå¼±` |
| ğŸ”¹ **ProxySQL** | `ä¸“ä¸šMySQLä»£ç†` | `MySQLç¯å¢ƒ` | `æ€§èƒ½ä¼˜ç§€ä½†å­¦ä¹ æˆæœ¬é«˜` |
| ğŸ”¹ **Atlas** | `360å¼€æºï¼Œè½»é‡çº§` | `ä¸­å°å‹é¡¹ç›®` | `ç®€å•æ˜“ç”¨ä½†åŠŸèƒ½æœ‰é™` |

---

## 2. ğŸ—ï¸ é«˜å¯ç”¨æ¶æ„è®¾è®¡


### 2.1 å•ç‚¹æ•…éšœé—®é¢˜


**ä¼ ç»Ÿå•èŠ‚ç‚¹éƒ¨ç½²çš„é£é™©**ï¼š
```
åº”ç”¨æœåŠ¡å™¨ç¾¤
    â†“
ä»£ç†ä¸­é—´ä»¶(å•èŠ‚ç‚¹) â† è¿™é‡Œæ˜¯å•ç‚¹æ•…éšœé£é™©ï¼
    â†“
æ•°æ®åº“é›†ç¾¤
```

> âš ï¸ **é—®é¢˜**ï¼šå¦‚æœä»£ç†ä¸­é—´ä»¶æŒ‚äº†ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¸èƒ½è®¿é—®æ•°æ®åº“äº†

### 2.2 é«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆ


#### ğŸ”¸ æ–¹æ¡ˆä¸€ï¼šä¸»å¤‡æ¨¡å¼


```
è´Ÿè½½å‡è¡¡å™¨(VIP: 192.168.1.200)
         â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚             â”‚
ä¸»ä»£ç†         å¤‡ä»£ç†
(Active)     (Standby)
192.168.1.10  192.168.1.11
   â”‚             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    æ•°æ®åº“é›†ç¾¤
```

**å·¥ä½œåŸç†**ï¼š
- **æ­£å¸¸æƒ…å†µ**ï¼šä¸»ä»£ç†å¤„ç†æ‰€æœ‰è¯·æ±‚
- **æ•…éšœæƒ…å†µ**ï¼šå¤‡ä»£ç†è‡ªåŠ¨æ¥ç®¡ï¼ŒVIPæ¼‚ç§»åˆ°å¤‡æœº
- **æ¢å¤å**ï¼šå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨åˆ‡å›ä¸»ä»£ç†

**é…ç½®ç¤ºä¾‹ï¼ˆKeepalivedï¼‰**ï¼š
```bash
# ä¸»ä»£ç†é…ç½®
vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 100
    advert_int 1
    virtual_ipaddress {
        192.168.1.200
    }
}

# å¤‡ä»£ç†é…ç½®  
vrrp_instance VI_1 {
    state BACKUP
    interface eth0
    virtual_router_id 51
    priority 90  # ä¼˜å…ˆçº§æ¯”ä¸»ä½
    advert_int 1
    virtual_ipaddress {
        192.168.1.200
    }
}
```

#### ğŸ”¸ æ–¹æ¡ˆäºŒï¼šå¤šæ´»è´Ÿè½½å‡è¡¡æ¨¡å¼


```
        è´Ÿè½½å‡è¡¡å™¨
       /     |     \
   ä»£ç†1    ä»£ç†2    ä»£ç†3
(Active) (Active) (Active)
    \       |       /
     \      |      /
      æ•°æ®åº“é›†ç¾¤
```

**ä¼˜åŠ¿**ï¼š
- âœ… **æ€§èƒ½æ›´å¥½**ï¼šå¤šä¸ªä»£ç†åŒæ—¶å·¥ä½œï¼Œå¤„ç†èƒ½åŠ›å¼º
- âœ… **æ•…éšœå½±å“å°**ï¼šä¸€ä¸ªä»£ç†æŒ‚äº†å…¶ä»–ç»§ç»­å·¥ä½œ
- âœ… **æ‰©å±•æ€§å¥½**ï¼šå¯ä»¥éšæ—¶å¢åŠ ä»£ç†èŠ‚ç‚¹

**è´Ÿè½½å‡è¡¡é…ç½®ï¼ˆNginxï¼‰**ï¼š
```nginx
upstream mysql_proxy {
    server 192.168.1.10:3306 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:3306 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.12:3306 weight=1 max_fails=3 fail_timeout=30s;
    
    # å¥åº·æ£€æŸ¥
    check interval=3000 rise=2 fall=3 timeout=1000;
}

server {
    listen 3306;
    proxy_pass mysql_proxy;
    proxy_timeout 1s;
    proxy_connect_timeout 1s;
}
```

### 2.3 æ¶æ„é€‰æ‹©å»ºè®®


```
ğŸ¯ é€‰æ‹©ä¾æ®ï¼š

å°è§„æ¨¡åº”ç”¨ï¼ˆQPS < 1000ï¼‰ï¼š
â†’ ä¸»å¤‡æ¨¡å¼ï¼Œç®€å•å¯é 
â†’ æˆæœ¬ä½ï¼Œç»´æŠ¤ç®€å•

ä¸­ç­‰è§„æ¨¡åº”ç”¨ï¼ˆQPS 1000-10000ï¼‰ï¼š
â†’ åŒæ´»æ¨¡å¼ï¼Œæ€§èƒ½å¹³è¡¡
â†’ ä¸¤ä¸ªä»£ç†èŠ‚ç‚¹è¶³å¤Ÿ

å¤§è§„æ¨¡åº”ç”¨ï¼ˆQPS > 10000ï¼‰ï¼š
â†’ å¤šæ´»æ¨¡å¼ï¼Œæ°´å¹³æ‰©å±•
â†’ 3-5ä¸ªä»£ç†èŠ‚ç‚¹
```

---

## 3. ğŸ” æœåŠ¡å‘ç°ä¸æ³¨å†Œ


### 3.1 ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°


**é—®é¢˜åœºæ™¯**ï¼š
```
åº”ç”¨æœåŠ¡å™¨æœ‰10å°ï¼Œæ¯å°éƒ½è¦é…ç½®ä»£ç†ä¸­é—´ä»¶åœ°å€
å¦‚æœä»£ç†åœ°å€å˜äº†ï¼Œè¦æ”¹10ä¸ªé…ç½®æ–‡ä»¶ ğŸ˜±
```

**æœåŠ¡å‘ç°è§£å†³æ–¹æ¡ˆ**ï¼š
```
åº”ç”¨ â†’ æœåŠ¡å‘ç°ä¸­å¿ƒ â†’ è·å–ä»£ç†åœ°å€åˆ—è¡¨
       (å¦‚ï¼šConsul)    â†’ [proxy1, proxy2, proxy3]
```

**å·¥ä½œæµç¨‹**ï¼š
1. **æœåŠ¡æ³¨å†Œ**ï¼šä»£ç†ä¸­é—´ä»¶å¯åŠ¨æ—¶å‘æ³¨å†Œä¸­å¿ƒæŠ¥å‘Šè‡ªå·±çš„åœ°å€
2. **å¥åº·æ£€æŸ¥**ï¼šæ³¨å†Œä¸­å¿ƒå®šæœŸæ£€æŸ¥ä»£ç†æ˜¯å¦æ­£å¸¸
3. **æœåŠ¡å‘ç°**ï¼šåº”ç”¨ä»æ³¨å†Œä¸­å¿ƒè·å–å¯ç”¨çš„ä»£ç†åœ°å€
4. **åŠ¨æ€æ›´æ–°**ï¼šä»£ç†æŒ‚äº†è‡ªåŠ¨ä»åˆ—è¡¨ä¸­ç§»é™¤

### 3.2 ConsulæœåŠ¡æ³¨å†Œå®è·µ


#### ğŸ”¸ Consulé›†ç¾¤éƒ¨ç½²


```bash
# Consul ServerèŠ‚ç‚¹1
consul agent -server -datacenter=dc1 -node=consul-1 \
  -bind=192.168.1.21 -client=0.0.0.0 \
  -bootstrap-expect=3 -data-dir=/opt/consul/data \
  -log-level=INFO -ui

# Consul ServerèŠ‚ç‚¹2  
consul agent -server -datacenter=dc1 -node=consul-2 \
  -bind=192.168.1.22 -client=0.0.0.0 \
  -retry-join=192.168.1.21 -data-dir=/opt/consul/data \
  -log-level=INFO

# Consul ServerèŠ‚ç‚¹3
consul agent -server -datacenter=dc1 -node=consul-3 \
  -bind=192.168.1.23 -client=0.0.0.0 \
  -retry-join=192.168.1.21 -data-dir=/opt/consul/data \
  -log-level=INFO
```

#### ğŸ”¸ ä»£ç†ä¸­é—´ä»¶æ³¨å†Œ


**MyCatæ³¨å†Œè„šæœ¬**ï¼š
```bash
#!/bin/bash
# mycat-register.sh

CONSUL_URL="http://192.168.1.21:8500"
SERVICE_NAME="mysql-proxy"
SERVICE_ID="mysql-proxy-$(hostname)"
SERVICE_IP=$(hostname -I | awk '{print $1}')
SERVICE_PORT=8066

# æ³¨å†ŒæœåŠ¡
curl -X PUT $CONSUL_URL/v1/agent/service/register \
  -d '{
    "ID": "'$SERVICE_ID'",
    "Name": "'$SERVICE_NAME'",
    "Tags": ["mysql", "proxy", "mycat"],
    "Address": "'$SERVICE_IP'",
    "Port": '$SERVICE_PORT',
    "Check": {
      "TCP": "'$SERVICE_IP':'$SERVICE_PORT'",
      "Interval": "10s"
    }
  }'

echo "Service registered: $SERVICE_ID"
```

**å¥åº·æ£€æŸ¥é…ç½®**ï¼š
```json
{
  "service": {
    "name": "mysql-proxy",
    "id": "mysql-proxy-node1",
    "address": "192.168.1.10",
    "port": 8066,
    "checks": [
      {
        "name": "TCP Check",
        "tcp": "192.168.1.10:8066",
        "interval": "10s",
        "timeout": "3s"
      },
      {
        "name": "HTTP Health Check", 
        "http": "http://192.168.1.10:9066/health",
        "interval": "30s",
        "timeout": "5s"
      }
    ]
  }
}
```

### 3.3 åº”ç”¨ç«¯æœåŠ¡å‘ç°


**Javaåº”ç”¨é›†æˆ**ï¼š
```java
@Component
public class MySQLProxyDiscovery {
    
    @Autowired
    private ConsulClient consulClient;
    
    private List<String> proxyAddresses = new ArrayList<>();
    
    @PostConstruct
    public void initProxyList() {
        refreshProxyList();
        
        // å®šæœŸåˆ·æ–°ä»£ç†åˆ—è¡¨
        ScheduledExecutorService executor = Executors.newSingleThreadScheduledExecutor();
        executor.scheduleAtFixedRate(this::refreshProxyList, 30, 30, TimeUnit.SECONDS);
    }
    
    private void refreshProxyList() {
        try {
            // ä»Consulè·å–å¥åº·çš„ä»£ç†æœåŠ¡
            Response<List<HealthService>> response = 
                consulClient.getHealthServices("mysql-proxy", true, null);
            
            List<String> newAddresses = response.getValue().stream()
                .map(service -> service.getService().getAddress() + ":" 
                             + service.getService().getPort())
                .collect(Collectors.toList());
            
            this.proxyAddresses = newAddresses;
            logger.info("Updated proxy addresses: {}", proxyAddresses);
            
        } catch (Exception e) {
            logger.error("Failed to refresh proxy list", e);
        }
    }
    
    public String getProxyAddress() {
        if (proxyAddresses.isEmpty()) {
            throw new RuntimeException("No available proxy servers");
        }
        
        // ç®€å•è½®è¯¢è´Ÿè½½å‡è¡¡
        int index = ThreadLocalRandom.current().nextInt(proxyAddresses.size());
        return proxyAddresses.get(index);
    }
}
```

---

## 4. âš–ï¸ è´Ÿè½½å‡è¡¡ç­–ç•¥


### 4.1 è´Ÿè½½å‡è¡¡çš„å¿…è¦æ€§


**åœºæ™¯è¯´æ˜**ï¼š
```
3ä¸ªä»£ç†èŠ‚ç‚¹ï¼Œå¦‚æœè¯·æ±‚éƒ½å‘åˆ°ç¬¬1ä¸ªï¼š

ä»£ç†1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (100%è´Ÿè½½ï¼Œå¯èƒ½è¿‡è½½)
ä»£ç†2: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (0%è´Ÿè½½ï¼Œèµ„æºæµªè´¹)  
ä»£ç†3: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (0%è´Ÿè½½ï¼Œèµ„æºæµªè´¹)

åˆç†è´Ÿè½½å‡è¡¡åï¼š

ä»£ç†1: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (33%è´Ÿè½½)
ä»£ç†2: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (33%è´Ÿè½½)
ä»£ç†3: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (33%è´Ÿè½½)
```

### 4.2 å¸¸è§è´Ÿè½½å‡è¡¡ç®—æ³•


#### ğŸ”¸ è½®è¯¢ç®—æ³• (Round Robin)


**å·¥ä½œåŸç†**ï¼šè¯·æ±‚ä¾æ¬¡åˆ†é…ç»™æ¯ä¸ªæœåŠ¡å™¨
```
è¯·æ±‚1 â†’ ä»£ç†1
è¯·æ±‚2 â†’ ä»£ç†2  
è¯·æ±‚3 â†’ ä»£ç†3
è¯·æ±‚4 â†’ ä»£ç†1 (é‡æ–°å¼€å§‹)
```

**é€‚ç”¨åœºæ™¯**ï¼šæœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘æ—¶

**å®ç°ç¤ºä¾‹**ï¼š
```java
public class RoundRobinBalancer {
    private List<ProxyNode> nodes;
    private AtomicInteger currentIndex = new AtomicInteger(0);
    
    public ProxyNode selectNode() {
        if (nodes.isEmpty()) return null;
        
        int index = currentIndex.getAndIncrement() % nodes.size();
        return nodes.get(index);
    }
}
```

#### ğŸ”¸ åŠ æƒè½®è¯¢ (Weighted Round Robin)


**å·¥ä½œåŸç†**ï¼šæ ¹æ®æœåŠ¡å™¨æ€§èƒ½åˆ†é…ä¸åŒæƒé‡
```
ä»£ç†1(æƒé‡3): å¤„ç†3ä¸ªè¯·æ±‚
ä»£ç†2(æƒé‡2): å¤„ç†2ä¸ªè¯·æ±‚  
ä»£ç†3(æƒé‡1): å¤„ç†1ä¸ªè¯·æ±‚
```

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
proxies:
  - address: "192.168.1.10:8066"
    weight: 3  # é«˜æ€§èƒ½æœåŠ¡å™¨
  - address: "192.168.1.11:8066" 
    weight: 2  # ä¸­æ€§èƒ½æœåŠ¡å™¨
  - address: "192.168.1.12:8066"
    weight: 1  # ä½æ€§èƒ½æœåŠ¡å™¨
```

#### ğŸ”¸ æœ€å°‘è¿æ¥æ•° (Least Connections)


**å·¥ä½œåŸç†**ï¼šé€‰æ‹©å½“å‰è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨
```
ä»£ç†1: å½“å‰50ä¸ªè¿æ¥
ä»£ç†2: å½“å‰30ä¸ªè¿æ¥ â† é€‰æ‹©è¿™ä¸ª
ä»£ç†3: å½“å‰40ä¸ªè¿æ¥
```

**é€‚ç”¨åœºæ™¯**ï¼šé•¿è¿æ¥è¾ƒå¤šçš„åœºæ™¯

#### ğŸ”¸ ä¸€è‡´æ€§å“ˆå¸Œ (Consistent Hash)


**å·¥ä½œåŸç†**ï¼šæ ¹æ®è¯·æ±‚ç‰¹å¾ï¼ˆå¦‚ç”¨æˆ·IDï¼‰å›ºå®šè·¯ç”±åˆ°æŸä¸ªæœåŠ¡å™¨
```java
public class ConsistentHashBalancer {
    private TreeMap<Long, ProxyNode> ring = new TreeMap<>();
    
    public ProxyNode selectNode(String key) {
        if (ring.isEmpty()) return null;
        
        long hash = hash(key);
        Map.Entry<Long, ProxyNode> entry = ring.ceilingEntry(hash);
        
        return entry != null ? entry.getValue() : ring.firstEntry().getValue();
    }
}
```

**ä¼˜åŠ¿**ï¼šç”¨æˆ·è¯·æ±‚æ€»æ˜¯è·¯ç”±åˆ°åŒä¸€ä¸ªä»£ç†ï¼Œæœ‰åˆ©äºè¿æ¥å¤ç”¨

### 4.3 è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©


```
ğŸ“Š é€‰æ‹©å»ºè®®ï¼š

æ•°æ®åº“è¯»å†™åˆ†ç¦»åœºæ™¯ï¼š
â†’ åŠ æƒè½®è¯¢
â†’ è¯»åº“å¤šé…ç½®é«˜æƒé‡

é•¿è¿æ¥åº”ç”¨ï¼š
â†’ æœ€å°‘è¿æ¥æ•°ç®—æ³•
â†’ é¿å…è¿æ¥åˆ†å¸ƒä¸å‡

éœ€è¦ä¼šè¯ä¿æŒï¼š
â†’ ä¸€è‡´æ€§å“ˆå¸Œ
â†’ åŒç”¨æˆ·è¯·æ±‚å›ºå®šè·¯ç”±

ç®€å•åœºæ™¯ï¼š
â†’ è½®è¯¢ç®—æ³•
â†’ å®ç°ç®€å•ï¼Œæ€§èƒ½å¥½
```

---

## 5. ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²å®è·µ


### 5.1 ä¸ºä»€ä¹ˆè¦å®¹å™¨åŒ–éƒ¨ç½²


**ä¼ ç»Ÿéƒ¨ç½²çš„é—®é¢˜**ï¼š
```
ç¯å¢ƒä¸ä¸€è‡´ï¼š
å¼€å‘ç¯å¢ƒ: CentOS 7 + Java 8
æµ‹è¯•ç¯å¢ƒ: Ubuntu 18 + Java 11  
ç”Ÿäº§ç¯å¢ƒ: RedHat 7 + Java 8

éƒ¨ç½²å¤æ‚ï¼š
1. å®‰è£…Javaç¯å¢ƒ
2. é…ç½®ç¯å¢ƒå˜é‡
3. ä¸‹è½½ä»£ç†è½¯ä»¶åŒ…
4. ä¿®æ”¹é…ç½®æ–‡ä»¶
5. å¯åŠ¨æœåŠ¡
6. æ£€æŸ¥æ—¥å¿—...
```

**å®¹å™¨åŒ–çš„ä¼˜åŠ¿**ï¼š
- âœ… **ç¯å¢ƒä¸€è‡´**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ç›¸åŒ
- âœ… **éƒ¨ç½²ç®€å•**ï¼šä¸€ä¸ªå‘½ä»¤å¯åŠ¨æ•´ä¸ªæœåŠ¡
- âœ… **èµ„æºéš”ç¦»**ï¼šæ¯ä¸ªå®¹å™¨ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å½±å“
- âœ… **å¼¹æ€§ä¼¸ç¼©**ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨å¢å‡å®¹å™¨æ•°é‡

### 5.2 DockeråŒ–éƒ¨ç½²æ–¹æ¡ˆ


#### ğŸ”¸ MyCat Dockeré•œåƒæ„å»º


**Dockerfile**ï¼š
```dockerfile
FROM openjdk:8-jre-alpine

# åˆ›å»ºåº”ç”¨ç›®å½•
WORKDIR /opt/mycat

# å¤åˆ¶MyCatå®‰è£…åŒ…
COPY mycat-server-1.6.7.6.tar.gz /tmp/
RUN tar -xzf /tmp/mycat-server-1.6.7.6.tar.gz -C /opt/ \
    && mv /opt/mycat/* /opt/mycat/ \
    && rm -rf /tmp/mycat-server-1.6.7.6.tar.gz

# å¤åˆ¶é…ç½®æ–‡ä»¶
COPY conf/ /opt/mycat/conf/

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV MYCAT_HOME=/opt/mycat
ENV PATH=$PATH:$MYCAT_HOME/bin

# æš´éœ²ç«¯å£
EXPOSE 8066 9066

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \
    CMD nc -z localhost 8066 || exit 1

# å¯åŠ¨å‘½ä»¤
CMD ["/opt/mycat/bin/mycat", "console"]
```

**æ„å»ºé•œåƒ**ï¼š
```bash
# æ„å»ºé•œåƒ
docker build -t mysql-proxy:1.6.7 .

# æ¨é€åˆ°ç§æœ‰ä»“åº“
docker tag mysql-proxy:1.6.7 harbor.company.com/database/mysql-proxy:1.6.7
docker push harbor.company.com/database/mysql-proxy:1.6.7
```

#### ğŸ”¸ Docker Composeéƒ¨ç½²


**docker-compose.yml**ï¼š
```yaml
version: '3.8'

services:
  mysql-proxy-1:
    image: mysql-proxy:1.6.7
    hostname: mysql-proxy-1
    container_name: mysql-proxy-1
    ports:
      - "8066:8066"
      - "9066:9066"
    volumes:
      - ./conf:/opt/mycat/conf
      - ./logs:/opt/mycat/logs
    environment:
      - JAVA_OPTS=-Xmx2g -Xms2g
    networks:
      - mysql-proxy-net
    restart: unless-stopped
    
  mysql-proxy-2:
    image: mysql-proxy:1.6.7
    hostname: mysql-proxy-2
    container_name: mysql-proxy-2
    ports:
      - "8067:8066"
      - "9067:9066"
    volumes:
      - ./conf:/opt/mycat/conf
      - ./logs:/opt/mycat/logs
    environment:
      - JAVA_OPTS=-Xmx2g -Xms2g
    networks:
      - mysql-proxy-net
    restart: unless-stopped

  # è´Ÿè½½å‡è¡¡å™¨
  nginx:
    image: nginx:alpine
    ports:
      - "3306:3306"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - mysql-proxy-1
      - mysql-proxy-2
    networks:
      - mysql-proxy-net
    restart: unless-stopped

networks:
  mysql-proxy-net:
    driver: bridge
```

### 5.3 Kuberneteséƒ¨ç½²æ–¹æ¡ˆ


#### ğŸ”¸ Deploymenté…ç½®


```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql-proxy
  namespace: database
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: mysql-proxy
  template:
    metadata:
      labels:
        app: mysql-proxy
    spec:
      containers:
      - name: mysql-proxy
        image: harbor.company.com/database/mysql-proxy:1.6.7
        ports:
        - containerPort: 8066
          name: mysql-port
        - containerPort: 9066
          name: admin-port
        env:
        - name: JAVA_OPTS
          value: "-Xmx2g -Xms2g -XX:+UseG1GC"
        resources:
          requests:
            memory: "2Gi"
            cpu: "500m"
          limits:
            memory: "4Gi" 
            cpu: "2000m"
        livenessProbe:
          tcpSocket:
            port: 8066
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          tcpSocket:
            port: 8066
          initialDelaySeconds: 30
          periodSeconds: 10
        volumeMounts:
        - name: config-volume
          mountPath: /opt/mycat/conf
      volumes:
      - name: config-volume
        configMap:
          name: mysql-proxy-config
```

#### ğŸ”¸ Serviceé…ç½®


```yaml
apiVersion: v1
kind: Service
metadata:
  name: mysql-proxy-service
  namespace: database
spec:
  selector:
    app: mysql-proxy
  ports:
  - name: mysql
    port: 3306
    targetPort: 8066
    protocol: TCP
  - name: admin
    port: 9066
    targetPort: 9066
    protocol: TCP
  type: ClusterIP
  sessionAffinity: ClientIP  # ä¼šè¯ä¿æŒ
```

#### ğŸ”¸ HPAè‡ªåŠ¨ä¼¸ç¼©


```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: mysql-proxy-hpa
  namespace: database
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: mysql-proxy
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

---

## 6. ğŸ“Š ç›‘æ§å‘Šè­¦ä½“ç³»


### 6.1 ç›‘æ§çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§**ï¼š
```
æ²¡æœ‰ç›‘æ§çš„ç³»ç»Ÿå°±åƒç›²äººå¼€è½¦ï¼š

âŒ ä¸çŸ¥é“ç³»ç»Ÿæ˜¯å¦æ­£å¸¸è¿è¡Œ
âŒ å‡ºç°é—®é¢˜æ—¶æ— æ³•åŠæ—¶å‘ç°  
âŒ æ— æ³•åˆ†ææ€§èƒ½ç“¶é¢ˆ
âŒ æ— æ³•è¯„ä¼°ç³»ç»Ÿå®¹é‡
```

**ç›‘æ§è¦†ç›–çš„å±‚é¢**ï¼š
```
åº”ç”¨å±‚ç›‘æ§ï¼š
â”œâ”€â”€ è¯·æ±‚å“åº”æ—¶é—´
â”œâ”€â”€ é”™è¯¯ç‡ç»Ÿè®¡
â”œâ”€â”€ è¿æ¥æ± çŠ¶æ€
â””â”€â”€ ä¸šåŠ¡æŒ‡æ ‡

ç³»ç»Ÿå±‚ç›‘æ§ï¼š  
â”œâ”€â”€ CPUä½¿ç”¨ç‡
â”œâ”€â”€ å†…å­˜ä½¿ç”¨ç‡
â”œâ”€â”€ ç½‘ç»œIO
â””â”€â”€ ç£ç›˜IO

åŸºç¡€è®¾æ–½ç›‘æ§ï¼š
â”œâ”€â”€ æœåŠ¡å™¨çŠ¶æ€
â”œâ”€â”€ ç½‘ç»œè¿é€šæ€§
â””â”€â”€ å­˜å‚¨çŠ¶æ€
```

### 6.2 å…³é”®ç›‘æ§æŒ‡æ ‡


#### ğŸ”¸ æ€§èƒ½æŒ‡æ ‡


| æŒ‡æ ‡ç±»åˆ« | **ç›‘æ§é¡¹** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|----------|-----------|-------------|-------------|
| ğŸ”¹ **å“åº”æ—¶é—´** | `å¹³å‡å“åº”æ—¶é—´` | `< 100ms` | `> 500ms` |
| ğŸ”¹ **ååé‡** | `QPS(æ¯ç§’æŸ¥è¯¢æ•°)` | `æ ¹æ®ä¸šåŠ¡` | `ä¸‹é™50%` |
| ğŸ”¹ **é”™è¯¯ç‡** | `å¤±è´¥è¯·æ±‚æ¯”ä¾‹` | `< 0.1%` | `> 1%` |
| ğŸ”¹ **è¿æ¥æ•°** | `æ´»è·ƒè¿æ¥æ•°` | `< 80%æœ€å¤§å€¼` | `> 90%æœ€å¤§å€¼` |

#### ğŸ”¸ ç³»ç»Ÿèµ„æºæŒ‡æ ‡


```yaml
# Prometheusç›‘æ§é…ç½®
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'mysql-proxy'
    static_configs:
      - targets: ['proxy1:9066', 'proxy2:9066', 'proxy3:9066']
    metrics_path: /metrics
    scrape_interval: 10s
    
rule_files:
  - "mysql_proxy_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']
```

**å‘Šè­¦è§„åˆ™é…ç½®**ï¼š
```yaml
# mysql_proxy_rules.yml
groups:
- name: mysql_proxy_alerts
  rules:
  
  # é«˜å“åº”æ—¶é—´å‘Šè­¦
  - alert: HighResponseTime
    expr: mysql_proxy_response_time_avg > 500
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "MySQLä»£ç†å“åº”æ—¶é—´è¿‡é«˜"
      description: "ä»£ç†{{ $labels.instance }}å¹³å‡å“åº”æ—¶é—´ä¸º{{ $value }}ms"
      
  # é«˜é”™è¯¯ç‡å‘Šè­¦  
  - alert: HighErrorRate
    expr: mysql_proxy_error_rate > 0.01
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "MySQLä»£ç†é”™è¯¯ç‡è¿‡é«˜"
      description: "ä»£ç†{{ $labels.instance }}é”™è¯¯ç‡ä¸º{{ $value | humanizePercentage }}"
      
  # è¿æ¥æ•°å‘Šè­¦
  - alert: HighConnectionCount  
    expr: mysql_proxy_connections / mysql_proxy_max_connections > 0.9
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "MySQLä»£ç†è¿æ¥æ•°è¿‡é«˜"
      description: "ä»£ç†{{ $labels.instance }}è¿æ¥ä½¿ç”¨ç‡{{ $value | humanizePercentage }}"
```

### 6.3 ç›‘æ§æ•°æ®æ”¶é›†


#### ğŸ”¸ åº”ç”¨ç›‘æ§é›†æˆ


**MyCatç›‘æ§æŒ‡æ ‡æš´éœ²**ï¼š
```java
@Component
public class MyCatMetricsCollector {
    
    private final MeterRegistry meterRegistry;
    
    public MyCatMetricsCollector(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        initMetrics();
    }
    
    private void initMetrics() {
        // å“åº”æ—¶é—´ç›‘æ§
        Timer.Sample.start(meterRegistry)
            .stop(Timer.builder("mysql.proxy.response.time")
                .description("MySQL proxy response time")
                .register(meterRegistry));
        
        // è¿æ¥æ•°ç›‘æ§
        Gauge.builder("mysql.proxy.connections.active")
            .description("Active connections")
            .register(meterRegistry, this, MyCatMetricsCollector::getActiveConnections);
            
        // é”™è¯¯è®¡æ•°
        Counter.builder("mysql.proxy.errors.total")
            .description("Total errors")
            .register(meterRegistry);
    }
    
    private double getActiveConnections(MyCatMetricsCollector collector) {
        // è·å–MyCatæ´»è·ƒè¿æ¥æ•°çš„é€»è¾‘
        return MyCatServer.getInstance().getConnectionCount();
    }
}
```

#### ğŸ”¸ æ—¥å¿—ç›‘æ§


**ç»“æ„åŒ–æ—¥å¿—é…ç½®**ï¼š
```xml
<!-- logback-spring.xml -->
<configuration>
    <appender name="JSON" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <timestamp/>
                <logLevel/>
                <loggerName/>
                <message/>
                <mdc/>
                <arguments/>
            </providers>
        </encoder>
    </appender>
    
    <!-- æ…¢æŸ¥è¯¢æ—¥å¿— -->
    <appender name="SLOW_QUERY" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>/var/log/mycat/slow-query.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>/var/log/mycat/slow-query.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <logger name="slow-query" level="INFO" additivity="false">
        <appender-ref ref="SLOW_QUERY"/>
    </logger>
    
    <root level="INFO">
        <appender-ref ref="JSON"/>
    </root>
</configuration>
```

### 6.4 å‘Šè­¦é€šçŸ¥æœºåˆ¶


#### ğŸ”¸ å¤šæ¸ é“å‘Šè­¦


**AlertManageré…ç½®**ï¼š
```yaml
# alertmanager.yml
global:
  smtp_smarthost: 'smtp.company.com:587'
  smtp_from: 'alerts@company.com'

route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'
  routes:
  - match:
      severity: critical
    receiver: 'database.team'
  - match:
      severity: warning  
    receiver: 'ops.team'

receivers:
- name: 'web.hook'
  webhook_configs:
  - url: 'http://webhook.company.com/alerts'

- name: 'database.team'
  email_configs:
  - to: 'dba@company.com'
    subject: '[ä¸¥é‡]æ•°æ®åº“ä»£ç†å‘Šè­¦'
    body: |
      å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
      å‘Šè­¦çº§åˆ«: {{ .CommonLabels.severity }}
      å‘Šè­¦è¯¦æƒ…: {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/xxx'
    channel: '#database-alerts'
    
- name: 'ops.team'
  email_configs:
  - to: 'ops@company.com'
    subject: '[è­¦å‘Š]ç³»ç»Ÿå‘Šè­¦'
```

#### ğŸ”¸ å‘Šè­¦å‡çº§æœºåˆ¶


```
å‘Šè­¦å‡çº§æµç¨‹ï¼š

Level 1 (Warning):
â””â”€â”€ å‘é€é‚®ä»¶/Slack â†’ è¿ç»´å›¢é˜Ÿ

Level 2 (Critical):  
â”œâ”€â”€ å‘é€é‚®ä»¶/Slack â†’ DBAå›¢é˜Ÿ
â”œâ”€â”€ çŸ­ä¿¡é€šçŸ¥ â†’ å€¼ç­äººå‘˜
â””â”€â”€ ç”µè¯å‘Šè­¦ â†’ ç´§æ€¥è”ç³»äºº

Level 3 (Emergency):
â”œâ”€â”€ è‡ªåŠ¨åŒ–å¤„ç† â†’ æ•…éšœè½¬ç§»
â”œâ”€â”€ å‡çº§é€šçŸ¥ â†’ æŠ€æœ¯æ€»ç›‘
â””â”€â”€ äº‹æ•…å“åº” â†’ åº”æ€¥é¢„æ¡ˆ
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä»£ç†ä¸­é—´ä»¶ï¼šåº”ç”¨ä¸æ•°æ®åº“é—´çš„æ™ºèƒ½è·¯ç”±å±‚ï¼Œæä¾›è¯»å†™åˆ†ç¦»ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½
ğŸ”¸ é«˜å¯ç”¨æ¶æ„ï¼šé€šè¿‡ä¸»å¤‡æˆ–å¤šæ´»æ¨¡å¼é¿å…å•ç‚¹æ•…éšœï¼Œä¿è¯ç³»ç»Ÿç¨³å®šæ€§
ğŸ”¸ æœåŠ¡å‘ç°ï¼šåŠ¨æ€ç®¡ç†æœåŠ¡åœ°å€ï¼Œé¿å…ç¡¬ç¼–ç é…ç½®ï¼Œæé«˜ç³»ç»Ÿçµæ´»æ€§
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šåˆç†åˆ†é…è¯·æ±‚åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œæé«˜ç³»ç»Ÿå¤„ç†èƒ½åŠ›
ğŸ”¸ å®¹å™¨åŒ–éƒ¨ç½²ï¼šç»Ÿä¸€ç¯å¢ƒï¼Œç®€åŒ–éƒ¨ç½²ï¼Œæé«˜å¯ç»´æŠ¤æ€§
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šå®æ—¶æŒæ¡ç³»ç»ŸçŠ¶æ€ï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é«˜å¯ç”¨çš„æœ¬è´¨**
```
æ ¸å¿ƒæ€æƒ³ï¼š
- æ¶ˆé™¤å•ç‚¹æ•…éšœï¼šä»»ä½•å•ä¸ªç»„ä»¶æ•…éšœéƒ½ä¸å½±å“æ•´ä½“æœåŠ¡
- å¿«é€Ÿæ•…éšœæ¢å¤ï¼šæ•…éšœå‘ç”Ÿæ—¶èƒ½å¤Ÿå¿«é€Ÿåˆ‡æ¢åˆ°å¤‡ç”¨èŠ‚ç‚¹
- æœåŠ¡é™çº§ï¼šåœ¨éƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨æ—¶ä¿è¯æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸

å®ç°è¦ç‚¹ï¼š
- å†—ä½™éƒ¨ç½²ï¼šå¤šä¸ªèŠ‚ç‚¹æä¾›ç›¸åŒæœåŠ¡
- å¥åº·æ£€æŸ¥ï¼šåŠæ—¶å‘ç°èŠ‚ç‚¹å¼‚å¸¸
- è‡ªåŠ¨åˆ‡æ¢ï¼šæ— äººå·¥å¹²é¢„çš„æ•…éšœè½¬ç§»
```

**ğŸ”¹ æœåŠ¡å‘ç°çš„ä»·å€¼**
```
è§£å†³çš„é—®é¢˜ï¼š
- é…ç½®ç®¡ç†ï¼šé¿å…ç¡¬ç¼–ç æœåŠ¡åœ°å€
- åŠ¨æ€æ‰©ç¼©å®¹ï¼šæ–°èŠ‚ç‚¹è‡ªåŠ¨åŠ å…¥æœåŠ¡åˆ—è¡¨
- æ•…éšœéš”ç¦»ï¼šå¼‚å¸¸èŠ‚ç‚¹è‡ªåŠ¨ä»æœåŠ¡åˆ—è¡¨ç§»é™¤

å…³é”®æœºåˆ¶ï¼š
- æœåŠ¡æ³¨å†Œï¼šæœåŠ¡å¯åŠ¨æ—¶ä¸»åŠ¨æ³¨å†Œ
- å¥åº·æ£€æŸ¥ï¼šå®šæœŸæ£€æµ‹æœåŠ¡å¯ç”¨æ€§
- é…ç½®æ›´æ–°ï¼šå®¢æˆ·ç«¯åŠ¨æ€è·å–æœ€æ–°æœåŠ¡åˆ—è¡¨
```

**ğŸ”¹ å®¹å™¨åŒ–çš„ä¼˜åŠ¿**
```
ç¯å¢ƒä¸€è‡´æ€§ï¼š
- å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ç›¸åŒ
- é¿å…"åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘"çš„é—®é¢˜

éƒ¨ç½²ç®€åŒ–ï¼š
- ä¸€ä¸ªé•œåƒåŒ…å«æ‰€æœ‰ä¾èµ–
- ä¸€æ¡å‘½ä»¤å®Œæˆéƒ¨ç½²

èµ„æºåˆ©ç”¨ï¼š
- è½»é‡çº§è™šæ‹ŸåŒ–ï¼Œå¼€é”€å°
- å¿«é€Ÿå¯åŠ¨å’Œåœæ­¢
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ¶æ„é€‰æ‹©ç­–ç•¥**
```
å°å‹é¡¹ç›®ï¼ˆç”¨æˆ· < 10ä¸‡ï¼‰ï¼š
âœ… å•ä¸»å¤‡ä»£ç† + ç®€å•è´Ÿè½½å‡è¡¡
âœ… Docker Composeéƒ¨ç½²
âœ… åŸºç¡€ç›‘æ§ï¼ˆæ—¥å¿— + ç®€å•æŒ‡æ ‡ï¼‰

ä¸­å‹é¡¹ç›®ï¼ˆç”¨æˆ· 10ä¸‡-100ä¸‡ï¼‰ï¼š
âœ… å¤šæ´»ä»£ç† + æœåŠ¡å‘ç°
âœ… Kuberneteséƒ¨ç½²
âœ… å®Œæ•´ç›‘æ§å‘Šè­¦ä½“ç³»

å¤§å‹é¡¹ç›®ï¼ˆç”¨æˆ· > 100ä¸‡ï¼‰ï¼š
âœ… åˆ†å±‚ä»£ç†æ¶æ„
âœ… äº‘åŸç”Ÿéƒ¨ç½²æ–¹æ¡ˆ  
âœ… å…¨é“¾è·¯ç›‘æ§ + è‡ªåŠ¨åŒ–è¿ç»´
```

**ğŸ”§ éƒ¨ç½²æœ€ä½³å®è·µ**
```
è§„åˆ’é˜¶æ®µï¼š
- è¯„ä¼°ä¸šåŠ¡è§„æ¨¡å’Œå¢é•¿é¢„æœŸ
- è®¾è®¡åˆç†çš„æ¶æ„æ–¹æ¡ˆ
- åˆ¶å®šè¯¦ç»†çš„éƒ¨ç½²è®¡åˆ’

å®æ–½é˜¶æ®µï¼š
- åˆ†é˜¶æ®µéƒ¨ç½²ï¼Œé™ä½é£é™©
- å……åˆ†çš„æµ‹è¯•éªŒè¯
- å®Œå–„çš„å›æ»šé¢„æ¡ˆ

è¿ç»´é˜¶æ®µï¼š
- å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»
- å®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
- æŒç»­ä¼˜åŒ–å’Œæ”¹è¿›
```

**âš ï¸ å¸¸è§é—®é¢˜é¢„é˜²**
```
é…ç½®é—®é¢˜ï¼š
- ç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œé¿å…é…ç½®æ¼‚ç§»
- ç¯å¢ƒéš”ç¦»ï¼Œé˜²æ­¢é…ç½®äº’ç›¸å½±å“

æ€§èƒ½é—®é¢˜ï¼š
- åˆç†è®¾ç½®è¿æ¥æ± å‚æ•°
- ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
- å®šæœŸè¿›è¡Œæ€§èƒ½æµ‹è¯•

å®‰å…¨é—®é¢˜ï¼š
- ç½‘ç»œè®¿é—®æ§åˆ¶
- æ•°æ®ä¼ è¾“åŠ å¯†
- è®¿é—®æƒé™æœ€å°åŒ–åŸåˆ™
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- ä»£ç†ä¸­é—´ä»¶æ˜¯åº”ç”¨ä¸æ•°æ®åº“é—´çš„æ™ºèƒ½æ¡¥æ¢ï¼Œæä¾›è·¯ç”±å’Œç®¡ç†åŠŸèƒ½
- é«˜å¯ç”¨é€šè¿‡å†—ä½™å’Œè‡ªåŠ¨åˆ‡æ¢é¿å…å•ç‚¹æ•…éšœ
- æœåŠ¡å‘ç°è®©ç³»ç»Ÿæ›´çµæ´»ï¼Œå®¹å™¨åŒ–è®©éƒ¨ç½²æ›´ç®€å•
- ç›‘æ§å‘Šè­¦æ˜¯ç³»ç»Ÿç¨³å®šè¿è¡Œçš„é‡è¦ä¿éšœ
- æ¶æ„è®¾è®¡è¦æ ¹æ®ä¸šåŠ¡è§„æ¨¡é€‰æ‹©åˆé€‚çš„å¤æ‚åº¦