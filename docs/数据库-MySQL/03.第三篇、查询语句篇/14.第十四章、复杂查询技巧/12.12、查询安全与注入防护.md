---
title: 12ã€æŸ¥è¯¢å®‰å…¨ä¸æ³¨å…¥é˜²æŠ¤
---
## ğŸ“š ç›®å½•

1. [SQLæ³¨å…¥é˜²æŠ¤æ¦‚è¿°](#1-SQLæ³¨å…¥é˜²æŠ¤æ¦‚è¿°)
2. [SQLæ³¨å…¥åŸç†ä¸å±å®³](#2-SQLæ³¨å…¥åŸç†ä¸å±å®³)
3. [å‚æ•°åŒ–æŸ¥è¯¢æœºåˆ¶](#3-å‚æ•°åŒ–æŸ¥è¯¢æœºåˆ¶)
4. [è¾“å…¥éªŒè¯ç­–ç•¥](#4-è¾“å…¥éªŒè¯ç­–ç•¥)
5. [æƒé™æ§åˆ¶æŸ¥è¯¢](#5-æƒé™æ§åˆ¶æŸ¥è¯¢)
6. [å®‰å…¨æŸ¥è¯¢è®¾è®¡](#6-å®‰å…¨æŸ¥è¯¢è®¾è®¡)
7. [é˜²æŠ¤å·¥å…·ä¸æŠ€æœ¯](#7-é˜²æŠ¤å·¥å…·ä¸æŠ€æœ¯)
8. [æœ€ä½³å®è·µæŒ‡å¯¼](#8-æœ€ä½³å®è·µæŒ‡å¯¼)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ SQLæ³¨å…¥é˜²æŠ¤æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯SQLæ³¨å…¥


**ç®€å•ç†è§£**ï¼šSQLæ³¨å…¥å°±åƒæœ‰äººåœ¨ä½ çš„é“¶è¡Œè½¬è´¦å•ä¸Šå·å·åŠ äº†é¢å¤–çš„æŒ‡ä»¤ï¼Œè®©é“¶è¡Œä¸ä»…æ‰§è¡Œä½ æƒ³è¦çš„è½¬è´¦ï¼Œè¿˜æ‰§è¡Œäº†ä»–æƒ³è¦çš„æ¶æ„æ“ä½œã€‚

**ç°å®å¯¹æ¯”**ï¼š
```
é“¶è¡Œè½¬è´¦å•ï¼š                    SQLæŸ¥è¯¢ï¼š
è½¬è´¦ç»™ï¼šå¼ ä¸‰                    æŸ¥è¯¢ç”¨æˆ·ï¼šå¼ ä¸‰
é‡‘é¢ï¼š1000å…ƒ                   SELECT * FROM users WHERE name = 'å¼ ä¸‰'

æ¶æ„ç¯¡æ”¹ï¼š                      SQLæ³¨å…¥ï¼š
è½¬è´¦ç»™ï¼šå¼ ä¸‰ï¼›åŒæ—¶è½¬è´¦ç»™æå››500å…ƒ   SELECT * FROM users WHERE name = 'å¼ ä¸‰'; 
                              DROP TABLE users; --'
```

### 1.2 SQLæ³¨å…¥çš„åŸºæœ¬åŸç†


**ğŸ”¸ æ³¨å…¥æ”»å‡»çš„æœ¬è´¨**
```
æ­£å¸¸æŸ¥è¯¢æ„å›¾ï¼š
ç”¨æˆ·è¾“å…¥ï¼šadmin
SQLè¯­å¥ï¼šSELECT * FROM users WHERE username = 'admin'
ç»“æœï¼šæŸ¥è¯¢ç”¨æˆ·åä¸ºadminçš„ç”¨æˆ·ä¿¡æ¯

æ¶æ„æ³¨å…¥æ”»å‡»ï¼š
ç”¨æˆ·è¾“å…¥ï¼šadmin'; DROP TABLE users; --
SQLè¯­å¥ï¼šSELECT * FROM users WHERE username = 'admin'; DROP TABLE users; --'
ç»“æœï¼šå…ˆæŸ¥è¯¢adminç”¨æˆ·ï¼Œç„¶ååˆ é™¤æ•´ä¸ªç”¨æˆ·è¡¨ï¼

å…³é”®é—®é¢˜ï¼šç”¨æˆ·è¾“å…¥è¢«å½“ä½œSQLä»£ç æ‰§è¡Œï¼Œè€Œä¸æ˜¯çº¯ç²¹çš„æ•°æ®
```

### 1.3 SQLæ³¨å…¥çš„å±å®³ç¨‹åº¦


**ğŸ”¸ å®‰å…¨å¨èƒç­‰çº§**
```
æ•°æ®æ³„éœ²é£é™©ï¼š
â€¢ ç»•è¿‡ç™»å½•éªŒè¯ï¼Œè·å–ç®¡ç†å‘˜æƒé™
â€¢ æŸ¥è¯¢æ•æ„Ÿæ•°æ®ï¼ˆç”¨æˆ·å¯†ç ã€é“¶è¡Œå¡å·ï¼‰
â€¢ ä¸‹è½½æ•´ä¸ªæ•°æ®åº“å†…å®¹

æ•°æ®ç ´åé£é™©ï¼š
â€¢ åˆ é™¤å…³é”®ä¸šåŠ¡æ•°æ®
â€¢ ä¿®æ”¹é‡è¦é…ç½®ä¿¡æ¯
â€¢ ç ´åæ•°æ®å®Œæ•´æ€§

ç³»ç»Ÿæ§åˆ¶é£é™©ï¼š
â€¢ æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
â€¢ è·å–æœåŠ¡å™¨æ§åˆ¶æƒ
â€¢ æ¤å…¥æ¶æ„ä»£ç 

ä¸šåŠ¡å½±å“ï¼š
â€¢ å®¢æˆ·ä¿¡æ¯æ³„éœ² â†’ æ³•å¾‹è´£ä»»
â€¢ è´¢åŠ¡æ•°æ®è¢«ç¯¡æ”¹ â†’ ç»æµæŸå¤±
â€¢ ç³»ç»ŸæœåŠ¡ä¸­æ–­ â†’ ä¸šåŠ¡åœæ‘†
```

### 1.4 SQLæ³¨å…¥æ”»å‡»åˆ†ç±»


**å¸¸è§æ³¨å…¥ç±»å‹**ï¼š
```
Unionæ³¨å…¥ï¼šé€šè¿‡UNIONè¯­å¥è·å–å…¶ä»–è¡¨æ•°æ®
Booleanæ³¨å…¥ï¼šåˆ©ç”¨çœŸå‡è¿”å›æ¨æµ‹æ•°æ®åº“ä¿¡æ¯
Timeæ³¨å…¥ï¼šåˆ©ç”¨å»¶æ—¶å‡½æ•°æ¨æµ‹æ•°æ®
Erroræ³¨å…¥ï¼šé€šè¿‡é”™è¯¯ä¿¡æ¯æ³„éœ²æ•°æ®åº“ç»“æ„
Blindæ³¨å…¥ï¼šåœ¨æ²¡æœ‰æ˜¾ç¤ºç»“æœçš„æƒ…å†µä¸‹æ¨æµ‹ä¿¡æ¯
```

---

## 2. âš ï¸ SQLæ³¨å…¥åŸç†ä¸å±å®³


### 2.1 å…¸å‹æ³¨å…¥æ”»å‡»åœºæ™¯


**ğŸ”¸ ç™»å½•ç»•è¿‡æ”»å‡»**
```java
// å±é™©çš„ç™»å½•éªŒè¯ä»£ç 
public boolean login(String username, String password) {
    String sql = "SELECT * FROM users WHERE username = '" 
                + username + "' AND password = '" + password + "'";
    // ç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥åˆ°SQLä¸­
}

// æ­£å¸¸ç™»å½•ï¼š
ç”¨æˆ·åï¼šadmin
å¯†ç ï¼š123456
ç”ŸæˆSQLï¼šSELECT * FROM users WHERE username = 'admin' AND password = '123456'

// æ³¨å…¥æ”»å‡»ï¼š
ç”¨æˆ·åï¼šadmin'--
å¯†ç ï¼šä»»æ„å†…å®¹
ç”ŸæˆSQLï¼šSELECT * FROM users WHERE username = 'admin'--' AND password = 'ä»»æ„'
ç»“æœï¼š-- æ³¨é‡Šæ‰äº†å¯†ç éªŒè¯ï¼Œç›´æ¥ä»¥adminèº«ä»½ç™»å½•ï¼
```

**ğŸ”¸ æ•°æ®çªƒå–æ”»å‡»**
```java
// å±é™©çš„ç”¨æˆ·æŸ¥è¯¢ä»£ç 
public List<User> searchUsers(String keyword) {
    String sql = "SELECT id, name FROM users WHERE name LIKE '%" 
                + keyword + "%'";
    // ç›´æ¥æ‹¼æ¥æœç´¢å…³é”®è¯
}

// æ­£å¸¸æœç´¢ï¼š
å…³é”®è¯ï¼šå¼ 
ç”ŸæˆSQLï¼šSELECT id, name FROM users WHERE name LIKE '%å¼ %'

// æ³¨å…¥æ”»å‡»ï¼š
å…³é”®è¯ï¼š' UNION SELECT password, email FROM users WHERE '1'='1
ç”ŸæˆSQLï¼šSELECT id, name FROM users WHERE name LIKE '%' 
         UNION SELECT password, email FROM users WHERE '1'='1%'
ç»“æœï¼šä¸ä»…è¿”å›å§“åï¼Œè¿˜æ³„éœ²äº†æ‰€æœ‰ç”¨æˆ·çš„å¯†ç å’Œé‚®ç®±ï¼
```

### 2.2 æ³¨å…¥æ”»å‡»çš„æŠ€æœ¯æ‰‹æ®µ


**ğŸ”¸ å¸¸è§æ³¨å…¥æŠ€å·§**
```sql
-- 1. æ³¨é‡Šç»•è¿‡
ç”¨æˆ·è¾“å…¥ï¼šadmin'--
æ•ˆæœï¼šSELECT * FROM users WHERE username = 'admin'--'
è¯´æ˜ï¼š--åé¢çš„å†…å®¹è¢«æ³¨é‡Šæ‰

-- 2. æ°¸çœŸæ¡ä»¶
ç”¨æˆ·è¾“å…¥ï¼š' OR '1'='1
æ•ˆæœï¼šSELECT * FROM users WHERE username = '' OR '1'='1'
è¯´æ˜ï¼š'1'='1'æ°¸è¿œä¸ºçœŸï¼Œè¿”å›æ‰€æœ‰ç”¨æˆ·

-- 3. è”åˆæŸ¥è¯¢
ç”¨æˆ·è¾“å…¥ï¼š' UNION SELECT password FROM admin_users--
æ•ˆæœï¼šåŒæ—¶æŸ¥è¯¢æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜å¯†ç 

-- 4. å †å æŸ¥è¯¢
ç”¨æˆ·è¾“å…¥ï¼š'; DELETE FROM users; --
æ•ˆæœï¼šåœ¨æŸ¥è¯¢åæ‰§è¡Œåˆ é™¤æ“ä½œ

-- 5. å‡½æ•°åˆ©ç”¨
ç”¨æˆ·è¾“å…¥ï¼š'; SELECT SLEEP(5); --
æ•ˆæœï¼šè®©æ•°æ®åº“æš‚åœ5ç§’ï¼Œç”¨äºæ£€æµ‹æ³¨å…¥ç‚¹
```

### 2.3 æ”»å‡»æ£€æµ‹ä¸è¯†åˆ«


**ğŸ”¸ æ³¨å…¥æ”»å‡»çš„è¯†åˆ«ç‰¹å¾**
```
å¯ç–‘è¾“å…¥ç‰¹å¾ï¼š
â€¢ åŒ…å«SQLå…³é”®å­—ï¼šSELECT, UNION, DROP, DELETE
â€¢ åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼šå•å¼•å·ã€åˆ†å·ã€æ³¨é‡Šç¬¦
â€¢ å¼‚å¸¸é•¿åº¦ï¼šè¶…å‡ºæ­£å¸¸è¾“å…¥èŒƒå›´
â€¢ ç¼–ç ç»•è¿‡ï¼šä½¿ç”¨URLç¼–ç ã€Unicodeç¼–ç 

ç³»ç»Ÿå¼‚å¸¸è¡¨ç°ï¼š
â€¢ æŸ¥è¯¢æ‰§è¡Œæ—¶é—´å¼‚å¸¸
â€¢ è¿”å›ç»“æœæ•°é‡å¼‚å¸¸  
â€¢ æ•°æ®åº“é”™è¯¯æ—¥å¿—å¢åŠ 
â€¢ ç³»ç»Ÿèµ„æºæ¶ˆè€—å¼‚å¸¸
```

**ğŸ”¸ æ”»å‡»æ—¥å¿—åˆ†æ**
```
MySQLé”™è¯¯æ—¥å¿—ä¸­çš„æ³¨å…¥ç—•è¿¹ï¼š

æ­£å¸¸æŸ¥è¯¢æ—¥å¿—ï¼š
[INFO] Query: SELECT * FROM users WHERE id = 1
[INFO] Execution time: 0.001s, Rows: 1

å¯ç–‘æ³¨å…¥æ—¥å¿—ï¼š
[ERROR] Query: SELECT * FROM users WHERE name = 'test' UNION SELECT password FROM admin_users--'
[ERROR] Syntax error at line 1 near 'UNION'
[WARN] Query execution time: 0.156s, Rows: 1000+

åˆ†æè¦ç‚¹ï¼š
â€¢ æŸ¥è¯¢è¯­å¥åŒ…å«å¤šä¸ªSQLå‘½ä»¤
â€¢ é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºè¯­æ³•å¼‚å¸¸
â€¢ è¿”å›è¡Œæ•°è¿œè¶…é¢„æœŸ
â€¢ æ‰§è¡Œæ—¶é—´å¼‚å¸¸å¢é•¿
```

### 2.4 æ³¨å…¥æ”»å‡»çš„å‘å±•è¶‹åŠ¿


**ğŸ”¸ ç°ä»£æ”»å‡»æ‰‹æ®µ**
```
ä¼ ç»Ÿæ³¨å…¥ â†’ ç°ä»£é«˜çº§æ³¨å…¥ï¼š

ç›²æ³¨æ”»å‡»ï¼š
â€¢ ä¸ä¾èµ–é”™è¯¯ä¿¡æ¯
â€¢ é€šè¿‡æ—¶é—´å»¶è¿Ÿåˆ¤æ–­
â€¢ é€ä½çŒœæµ‹æ•°æ®å†…å®¹

ç¼–ç ç»•è¿‡ï¼š
â€¢ URLç¼–ç ï¼š%27 ä»£æ›¿ '
â€¢ Unicodeç¼–ç ï¼šç»•è¿‡è¿‡æ»¤å™¨
â€¢ äºŒæ¬¡ç¼–ç ï¼šå¤šé‡ç¼–ç åµŒå¥—

è‡ªåŠ¨åŒ–å·¥å…·ï¼š
â€¢ sqlmapç­‰è‡ªåŠ¨åŒ–æ³¨å…¥å·¥å…·
â€¢ æ‰¹é‡æ‰«æå’Œæ”»å‡»
â€¢ AIè¾…åŠ©çš„æ™ºèƒ½æ³¨å…¥
```

---

## 3. ğŸ›¡ï¸ å‚æ•°åŒ–æŸ¥è¯¢æœºåˆ¶


### 3.1 å‚æ•°åŒ–æŸ¥è¯¢çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å‚æ•°åŒ–æŸ¥è¯¢**ï¼šå°±åƒå¡«ç©ºé¢˜ä¸€æ ·ï¼ŒSQLè¯­å¥çš„ç»“æ„æ˜¯å›ºå®šçš„ï¼Œåªæœ‰æ•°æ®éƒ¨åˆ†æ˜¯å˜åŒ–çš„ç©ºç™½ï¼Œè¿™æ ·å°±ç¡®ä¿äº†ç”¨æˆ·è¾“å…¥ä¸ä¼šæ”¹å˜SQLçš„é€»è¾‘ç»“æ„ã€‚

**å‚æ•°åŒ–æŸ¥è¯¢åŸç†å›¾**ï¼š
```
ä¼ ç»Ÿå­—ç¬¦ä¸²æ‹¼æ¥ï¼š                 å‚æ•°åŒ–æŸ¥è¯¢ï¼š
                              
SQLæ¨¡æ¿ + ç”¨æˆ·è¾“å…¥ = æœ€ç»ˆSQL      SQLæ¨¡æ¿ï¼šSELECT * FROM users WHERE id = ?
      â†“                       å‚æ•°å€¼ï¼š[123]
å¯èƒ½è¢«æ¶æ„ä¿®æ”¹                    æ•°æ®åº“åˆ†åˆ«å¤„ç†æ¨¡æ¿å’Œå‚æ•°
      â†“                             â†“
æ‰§è¡ŒæœªçŸ¥çš„SQLä»£ç                 å®‰å…¨æ‰§è¡Œé¢„å®šä¹‰çš„SQLç»“æ„
```

### 3.2 å‚æ•°åŒ–æŸ¥è¯¢çš„å·¥ä½œæœºåˆ¶


**ğŸ”¸ SQLè§£æä¸æ‰§è¡Œåˆ†ç¦»**
```
ä¼ ç»Ÿæ–¹å¼ï¼š
ç”¨æˆ·è¾“å…¥ â†’ å­—ç¬¦ä¸²æ‹¼æ¥ â†’ SQLè§£æ â†’ æ‰§è¡Œ
é—®é¢˜ï¼šç”¨æˆ·è¾“å…¥å¯èƒ½æ”¹å˜SQLç»“æ„

å‚æ•°åŒ–æ–¹å¼ï¼š
SQLæ¨¡æ¿ â†’ é¢„ç¼–è¯‘å’Œè§£æ â†’ å‚æ•°ç»‘å®š â†’ æ‰§è¡Œ
         â†‘                    â†‘
    ç»“æ„å›ºå®š               åªä¼ é€’æ•°æ®

å…³é”®ä¼˜åŠ¿ï¼š
â€¢ SQLç»“æ„åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œè¿è¡Œæ—¶ä¸å¯æ›´æ”¹
â€¢ å‚æ•°å€¼åªèƒ½ä½œä¸ºæ•°æ®ï¼Œä¸èƒ½ä½œä¸ºSQLä»£ç 
â€¢ æ•°æ®åº“å¼•æ“èƒ½åŒºåˆ†ä»£ç å’Œæ•°æ®
```

### 3.3 ä¸åŒè¯­è¨€çš„å‚æ•°åŒ–æŸ¥è¯¢å®ç°


**ğŸ”¸ Java PreparedStatement**
```java
// å±é™©çš„æ–¹å¼ï¼ˆå®¹æ˜“è¢«æ³¨å…¥ï¼‰
public User getUserByName(String name) {
    String sql = "SELECT * FROM users WHERE name = '" + name + "'";
    // ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°SQLä¸­
    return jdbcTemplate.queryForObject(sql, User.class);
}

// å®‰å…¨çš„æ–¹å¼ï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
public User getUserByName(String name) {
    String sql = "SELECT * FROM users WHERE name = ?";
    return jdbcTemplate.queryForObject(sql, User.class, name);
}

// PreparedStatementæ–¹å¼
public User getUserByNamePS(String name) throws SQLException {
    String sql = "SELECT * FROM users WHERE name = ?";
    PreparedStatement ps = connection.prepareStatement(sql);
    ps.setString(1, name);  // å‚æ•°ç´¢å¼•ä»1å¼€å§‹
    ResultSet rs = ps.executeQuery();
    return mapToUser(rs);
}
```

**ğŸ”¸ Pythonå‚æ•°åŒ–æŸ¥è¯¢**
```python
# å±é™©æ–¹å¼
def get_user_dangerous(name):
    sql = f"SELECT * FROM users WHERE name = '{name}'"
    cursor.execute(sql)  # ç›´æ¥æ‰§è¡Œæ‹¼æ¥çš„SQL

# å®‰å…¨æ–¹å¼
def get_user_safe(name):
    sql = "SELECT * FROM users WHERE name = %s"
    cursor.execute(sql, (name,))  # ä½¿ç”¨å‚æ•°å…ƒç»„
    
# å­—å…¸å‚æ•°æ–¹å¼
def get_user_dict(name, age):
    sql = "SELECT * FROM users WHERE name = %(name)s AND age = %(age)s"
    cursor.execute(sql, {'name': name, 'age': age})
```

**ğŸ”¸ PHPå‚æ•°åŒ–æŸ¥è¯¢**
```php
// å±é™©æ–¹å¼
function getUserDangerous($name) {
    $sql = "SELECT * FROM users WHERE name = '$name'";
    return mysqli_query($connection, $sql);
}

// å®‰å…¨æ–¹å¼ï¼ˆPDOï¼‰
function getUserSafe($name) {
    $sql = "SELECT * FROM users WHERE name = ?";
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$name]);
    return $stmt->fetchAll();
}

// å‘½åå‚æ•°æ–¹å¼
function getUserNamed($name, $email) {
    $sql = "SELECT * FROM users WHERE name = :name AND email = :email";
    $stmt = $pdo->prepare($sql);
    $stmt->execute(['name' => $name, 'email' => $email]);
    return $stmt->fetchAll();
}
```

### 3.4 å‚æ•°åŒ–æŸ¥è¯¢çš„é«˜çº§ç‰¹æ€§


**ğŸ”¸ åŠ¨æ€å‚æ•°å¤„ç†**
```java
public class DynamicQueryBuilder {
    
    public List<User> searchUsers(Map<String, Object> filters) {
        StringBuilder sql = new StringBuilder("SELECT * FROM users WHERE 1=1");
        List<Object> params = new ArrayList<>();
        
        // åŠ¨æ€æ„å»ºWHEREæ¡ä»¶
        if (filters.containsKey("name")) {
            sql.append(" AND name = ?");
            params.add(filters.get("name"));
        }
        
        if (filters.containsKey("age")) {
            sql.append(" AND age >= ?");
            params.add(filters.get("age"));
        }
        
        if (filters.containsKey("city")) {
            sql.append(" AND city = ?");
            params.add(filters.get("city"));
        }
        
        return jdbcTemplate.query(sql.toString(), 
                                 params.toArray(), 
                                 new UserRowMapper());
    }
}
```

**ğŸ”¸ INå­å¥çš„å‚æ•°åŒ–å¤„ç†**
```java
// INå­å¥çš„å®‰å…¨å¤„ç†
public List<User> getUsersByIds(List<Long> userIds) {
    if (userIds.isEmpty()) return new ArrayList<>();
    
    // æ„å»ºå ä½ç¬¦ï¼š?,?,?
    String placeholders = String.join(",", 
        Collections.nCopies(userIds.size(), "?"));
    
    String sql = "SELECT * FROM users WHERE id IN (" + placeholders + ")";
    
    return jdbcTemplate.query(sql, 
                             userIds.toArray(), 
                             new UserRowMapper());
}
```

---

## 4. âœ… è¾“å…¥éªŒè¯ç­–ç•¥


### 4.1 è¾“å…¥éªŒè¯çš„å±‚æ¬¡é˜²æŠ¤


**å¤šå±‚éªŒè¯æ¶æ„**ï¼š
```
å®¢æˆ·ç«¯éªŒè¯ï¼ˆå‰ç«¯ï¼‰
    â†“ [åŸºç¡€æ ¼å¼æ£€æŸ¥]
åº”ç”¨å±‚éªŒè¯ï¼ˆåç«¯ï¼‰
    â†“ [ä¸šåŠ¡è§„åˆ™éªŒè¯]
æ•°æ®åº“å±‚éªŒè¯ï¼ˆMySQLï¼‰
    â†“ [æ•°æ®ç±»å‹å’Œçº¦æŸæ£€æŸ¥]
å­˜å‚¨å±‚éªŒè¯ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰
    â†“ [æœ€ç»ˆæ•°æ®æŒä¹…åŒ–]

æ¯ä¸€å±‚éƒ½è¦è¿›è¡ŒéªŒè¯ï¼Œä¸èƒ½ç›¸äº’ä¾èµ–
```

### 4.2 è¾“å…¥éªŒè¯ç­–ç•¥è¯¦è§£


**ğŸ”¸ ç™½åå•éªŒè¯ç­–ç•¥**
```java
public class InputValidator {
    
    // ç”¨æˆ·åç™½åå•éªŒè¯
    private static final Pattern USERNAME_PATTERN = 
        Pattern.compile("^[a-zA-Z0-9_]{3,20}$");
    
    // é‚®ç®±æ ¼å¼éªŒè¯
    private static final Pattern EMAIL_PATTERN = 
        Pattern.compile("^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$");
    
    public boolean validateUsername(String username) {
        return username != null && USERNAME_PATTERN.matcher(username).matches();
    }
    
    public boolean validateEmail(String email) {
        return email != null && EMAIL_PATTERN.matcher(email).matches();
    }
    
    // æ•°å­—èŒƒå›´éªŒè¯
    public boolean validateAge(Integer age) {
        return age != null && age >= 0 && age <= 150;
    }
    
    // æšä¸¾å€¼éªŒè¯
    public boolean validateGender(String gender) {
        return Arrays.asList("MALE", "FEMALE", "OTHER").contains(gender);
    }
}
```

**ğŸ”¸ é»‘åå•è¿‡æ»¤ç­–ç•¥**
```java
public class SQLInjectionFilter {
    
    // SQLæ³¨å…¥å…³é”®è¯é»‘åå•
    private static final Set<String> SQL_KEYWORDS = Set.of(
        "SELECT", "INSERT", "UPDATE", "DELETE", "DROP", 
        "UNION", "EXEC", "EXECUTE", "SCRIPT", "JAVASCRIPT"
    );
    
    // å±é™©å­—ç¬¦é»‘åå•
    private static final Set<Character> DANGEROUS_CHARS = Set.of(
        '\'', '"', ';', '-', '(', ')', '<', '>'
    );
    
    public String sanitizeInput(String input) {
        if (input == null) return null;
        
        String cleaned = input.trim().toUpperCase();
        
        // æ£€æŸ¥SQLå…³é”®è¯
        for (String keyword : SQL_KEYWORDS) {
            if (cleaned.contains(keyword)) {
                throw new SecurityException("è¾“å…¥åŒ…å«éæ³•SQLå…³é”®è¯: " + keyword);
            }
        }
        
        // ç§»é™¤æˆ–è½¬ä¹‰å±é™©å­—ç¬¦
        StringBuilder result = new StringBuilder();
        for (char c : input.toCharArray()) {
            if (DANGEROUS_CHARS.contains(c)) {
                result.append("\\").append(c);  // è½¬ä¹‰å¤„ç†
            } else {
                result.append(c);
            }
        }
        
        return result.toString();
    }
}
```

### 4.3 è¾“å…¥é•¿åº¦å’Œç±»å‹éªŒè¯


**ğŸ”¸ æ•°æ®ç±»å‹ä¸¥æ ¼éªŒè¯**
```java
public class TypeSafeValidator {
    
    // ä¸¥æ ¼çš„æ•´æ•°éªŒè¯
    public Long validateId(String idStr) {
        try {
            Long id = Long.parseLong(idStr);
            if (id <= 0) {
                throw new ValidationException("IDå¿…é¡»æ˜¯æ­£æ•´æ•°");
            }
            return id;
        } catch (NumberFormatException e) {
            throw new ValidationException("IDæ ¼å¼ä¸æ­£ç¡®");
        }
    }
    
    // æ—¥æœŸæ ¼å¼éªŒè¯
    public Date validateDate(String dateStr) {
        try {
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
            sdf.setLenient(false);  // ä¸¥æ ¼æ¨¡å¼
            Date date = sdf.parse(dateStr);
            
            // æ£€æŸ¥æ—¥æœŸèŒƒå›´åˆç†æ€§
            Date now = new Date();
            Date minDate = new Date(now.getTime() - 100L * 365 * 24 * 60 * 60 * 1000);
            
            if (date.after(now) || date.before(minDate)) {
                throw new ValidationException("æ—¥æœŸè¶…å‡ºåˆç†èŒƒå›´");
            }
            
            return date;
        } catch (ParseException e) {
            throw new ValidationException("æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨yyyy-MM-ddæ ¼å¼");
        }
    }
}
```

### 4.4 ä¸šåŠ¡é€»è¾‘éªŒè¯


**ğŸ”¸ ä¸Šä¸‹æ–‡ç›¸å…³éªŒè¯**
```java
public class BusinessValidator {
    
    // æƒé™ç›¸å…³éªŒè¯
    public void validateUserAccess(Long userId, Long targetUserId) {
        User currentUser = getCurrentUser();
        
        // ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®ï¼Œé™¤éæ˜¯ç®¡ç†å‘˜
        if (!currentUser.getId().equals(targetUserId) && 
            !currentUser.hasRole("ADMIN")) {
            throw new AccessDeniedException("æ— æƒè®¿é—®å…¶ä»–ç”¨æˆ·æ•°æ®");
        }
    }
    
    // ä¸šåŠ¡è§„åˆ™éªŒè¯
    public void validateOrderAmount(BigDecimal amount, Long userId) {
        User user = userService.getUser(userId);
        
        // æ£€æŸ¥ç”¨æˆ·ä½™é¢
        if (user.getBalance().compareTo(amount) < 0) {
            throw new BusinessException("ä½™é¢ä¸è¶³");
        }
        
        // æ£€æŸ¥å•ç¬”äº¤æ˜“é™é¢
        BigDecimal dailyLimit = user.getDailyLimit();
        if (amount.compareTo(dailyLimit) > 0) {
            throw new BusinessException("è¶…å‡ºå•æ—¥äº¤æ˜“é™é¢");
        }
    }
}
```

---

## 5. ğŸ” æƒé™æ§åˆ¶æŸ¥è¯¢


### 5.1 æ•°æ®åº“æƒé™æ§åˆ¶ä½“ç³»


**MySQLæƒé™å±‚æ¬¡ç»“æ„**ï¼š
```
å…¨å±€æƒé™ (Global Privileges)
    â”œâ”€ è¶…çº§ç®¡ç†å‘˜æƒé™ï¼šSUPER, PROCESS, RELOAD
    â”œâ”€ æ•°æ®åº“ç®¡ç†æƒé™ï¼šCREATE, DROP, ALTER
    â””â”€ ç”¨æˆ·ç®¡ç†æƒé™ï¼šCREATE USER, GRANT, REVOKE

åº“çº§æƒé™ (Database Privileges)  
    â”œâ”€ æ•°æ®æ“ä½œæƒé™ï¼šSELECT, INSERT, UPDATE, DELETE
    â”œâ”€ ç»“æ„æ“ä½œæƒé™ï¼šCREATE, DROP, ALTER, INDEX
    â””â”€ ç®¡ç†æƒé™ï¼šLOCK TABLES, REFERENCES

è¡¨çº§æƒé™ (Table Privileges)
    â”œâ”€ åŸºæœ¬æ“ä½œï¼šSELECT, INSERT, UPDATE, DELETE
    â”œâ”€ ç»“æ„ä¿®æ”¹ï¼šALTER, DROP, INDEX
    â””â”€ ç‰¹æ®Šæƒé™ï¼šTRIGGER, REFERENCES

å­—æ®µçº§æƒé™ (Column Privileges)
    â”œâ”€ æŸ¥è¯¢æƒé™ï¼šSELECT(column_list)
    â”œâ”€ ä¿®æ”¹æƒé™ï¼šUPDATE(column_list)
    â””â”€ æ’å…¥æƒé™ï¼šINSERT(column_list)
```

### 5.2 åº”ç”¨å±‚æƒé™æ§åˆ¶


**ğŸ”¸ åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰**
```java
public class QueryPermissionManager {
    
    // æƒé™æ£€æŸ¥è£…é¥°å™¨
    @PreAuthorize("hasPermission(#tableName, 'READ')")
    public List<Map<String, Object>> queryTable(String tableName, 
                                               String whereClause) {
        // æ„å»ºå®‰å…¨çš„æŸ¥è¯¢
        return buildSecureQuery(tableName, whereClause);
    }
    
    // æ•°æ®è¡Œçº§æƒé™æ§åˆ¶
    public String buildRowLevelSecurity(String baseSQL, User currentUser) {
        StringBuilder secureSQL = new StringBuilder(baseSQL);
        
        if (!currentUser.hasRole("ADMIN")) {
            // æ™®é€šç”¨æˆ·åªèƒ½çœ‹è‡ªå·±çš„æ•°æ®
            if (baseSQL.contains("FROM users")) {
                secureSQL.append(" AND user_id = ").append(currentUser.getId());
            }
            
            // é”€å”®äººå‘˜åªèƒ½çœ‹è‡ªå·±è´Ÿè´£çš„å®¢æˆ·
            if (currentUser.hasRole("SALES") && baseSQL.contains("FROM customers")) {
                secureSQL.append(" AND sales_rep_id = ").append(currentUser.getId());
            }
        }
        
        return secureSQL.toString();
    }
}
```

**ğŸ”¸ åŠ¨æ€æƒé™éªŒè¯**
```java
public class DynamicPermissionChecker {
    
    public boolean canAccessTable(String tableName, String operation) {
        User currentUser = SecurityContext.getCurrentUser();
        
        // æ£€æŸ¥è¡¨çº§æƒé™
        if (!hasTablePermission(currentUser, tableName, operation)) {
            return false;
        }
        
        // æ£€æŸ¥æ—¶é—´èŒƒå›´æƒé™ï¼ˆå¦‚åªèƒ½æŸ¥è¯¢æœ€è¿‘3ä¸ªæœˆçš„æ•°æ®ï¼‰
        if (operation.equals("SELECT") && isHistoricalTable(tableName)) {
            return hasTimeRangePermission(currentUser, tableName);
        }
        
        // æ£€æŸ¥æ•°æ®æ•æ„Ÿçº§åˆ«æƒé™
        SensitivityLevel tableLevel = getTableSensitivityLevel(tableName);
        return currentUser.getClearanceLevel().ordinal() >= tableLevel.ordinal();
    }
    
    // å­—æ®µçº§æƒé™è¿‡æ»¤
    public List<String> filterAllowedColumns(String tableName, 
                                           List<String> requestedColumns) {
        User currentUser = SecurityContext.getCurrentUser();
        List<String> allowedColumns = new ArrayList<>();
        
        for (String column : requestedColumns) {
            if (hasColumnPermission(currentUser, tableName, column)) {
                allowedColumns.add(column);
            }
        }
        
        return allowedColumns;
    }
}
```

### 5.3 æŸ¥è¯¢ç»“æœè„±æ•å¤„ç†


**ğŸ”¸ æ•æ„Ÿæ•°æ®è„±æ•**
```java
public class DataMaskingService {
    
    // ä¸åŒç±»å‹æ•°æ®çš„è„±æ•ç­–ç•¥
    public Object maskSensitiveData(Object value, String columnName, 
                                   String dataType) {
        if (value == null) return null;
        
        switch (columnName.toLowerCase()) {
            case "phone":
                return maskPhone(value.toString());
            case "email":  
                return maskEmail(value.toString());
            case "id_card":
                return maskIdCard(value.toString());
            case "bank_account":
                return maskBankAccount(value.toString());
            default:
                return value;
        }
    }
    
    private String maskPhone(String phone) {
        if (phone.length() >= 7) {
            return phone.substring(0, 3) + "****" + 
                   phone.substring(phone.length() - 4);
        }
        return "****";
    }
    
    private String maskEmail(String email) {
        int atIndex = email.indexOf('@');
        if (atIndex > 0) {
            String prefix = email.substring(0, Math.min(2, atIndex));
            String suffix = email.substring(atIndex);
            return prefix + "***" + suffix;
        }
        return "***@***.com";
    }
}
```

### 5.4 SQLæƒé™æ§åˆ¶å®è·µ


**ğŸ”¸ æœ€å°æƒé™åŸåˆ™**
```sql
-- ä¸ºåº”ç”¨åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
CREATE USER 'app_user'@'%' IDENTIFIED BY 'strong_password';

-- åªæˆäºˆå¿…è¦çš„æƒé™
GRANT SELECT, INSERT, UPDATE ON myapp.users TO 'app_user'@'%';
GRANT SELECT, INSERT, UPDATE ON myapp.orders TO 'app_user'@'%';

-- ç¦æ­¢å±é™©æ“ä½œ
-- ä¸æˆäºˆï¼šDROP, ALTER, CREATE, DELETEç­‰ç»“æ„æ€§æƒé™
-- ä¸æˆäºˆï¼šSUPER, PROCESS, FILEç­‰ç®¡ç†æƒé™

-- ä¸ºåªè¯»æŸ¥è¯¢åˆ›å»ºä¸“é—¨ç”¨æˆ·
CREATE USER 'readonly_user'@'%' IDENTIFIED BY 'readonly_password';
GRANT SELECT ON myapp.* TO 'readonly_user'@'%';

-- é™åˆ¶è¿æ¥æ•°å’ŒæŸ¥è¯¢é¢‘ç‡
ALTER USER 'app_user'@'%' 
WITH MAX_CONNECTIONS_PER_HOUR 1000
     MAX_QUERIES_PER_HOUR 10000;
```

---

## 6. ğŸ—ï¸ å®‰å…¨æŸ¥è¯¢è®¾è®¡


### 6.1 å®‰å…¨æŸ¥è¯¢è®¾è®¡åŸåˆ™


**ğŸ”¸ é˜²å¾¡æ€§ç¼–ç¨‹åŸåˆ™**
```
å®‰å…¨è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ï¼š

1. é›¶ä¿¡ä»»åŸåˆ™ï¼šä¸ä¿¡ä»»ä»»ä½•å¤–éƒ¨è¾“å…¥
2. æœ€å°æƒé™åŸåˆ™ï¼šåªæˆäºˆå¿…è¦çš„æƒé™
3. æ·±åº¦é˜²æŠ¤åŸåˆ™ï¼šå¤šå±‚éªŒè¯å’Œè¿‡æ»¤
4. å¤±è´¥å®‰å…¨åŸåˆ™ï¼šå‡ºé”™æ—¶é€‰æ‹©å®‰å…¨çš„è¡Œä¸º
5. å®¡è®¡è·Ÿè¸ªåŸåˆ™ï¼šè®°å½•æ‰€æœ‰å…³é”®æ“ä½œ
```

### 6.2 å®‰å…¨æŸ¥è¯¢æ¨¡å¼è®¾è®¡


**ğŸ”¸ æŸ¥è¯¢æ„å»ºå™¨æ¨¡å¼**
```java
public class SecureQueryBuilder {
    private StringBuilder query;
    private List<Object> parameters;
    private Set<String> allowedTables;
    
    public SecureQueryBuilder() {
        this.query = new StringBuilder();
        this.parameters = new ArrayList<>();
        this.allowedTables = loadAllowedTables();
    }
    
    public SecureQueryBuilder select(String... columns) {
        // éªŒè¯åˆ—åæ˜¯å¦åˆæ³•
        validateColumnNames(columns);
        query.append("SELECT ").append(String.join(",", columns));
        return this;
    }
    
    public SecureQueryBuilder from(String tableName) {
        // éªŒè¯è¡¨åæ˜¯å¦åœ¨ç™½åå•ä¸­
        if (!allowedTables.contains(tableName)) {
            throw new SecurityException("ä¸å…è®¸è®¿é—®è¡¨: " + tableName);
        }
        query.append(" FROM ").append(tableName);
        return this;
    }
    
    public SecureQueryBuilder where(String column, Object value) {
        validateColumnName(column);
        query.append(" AND ").append(column).append(" = ?");
        parameters.add(value);
        return this;
    }
    
    public QueryResult execute() {
        return jdbcTemplate.query(query.toString(), 
                                 parameters.toArray(), 
                                 new GenericRowMapper());
    }
}
```

**ğŸ”¸ å®‰å…¨æŸ¥è¯¢æ¨¡æ¿**
```java
public class SecureQueryTemplates {
    
    // ç”¨æˆ·æŸ¥è¯¢æ¨¡æ¿
    public static final String USER_BY_ID = 
        "SELECT id, name, email, created_at FROM users WHERE id = ? AND status = 'active'";
    
    // è®¢å•æŸ¥è¯¢æ¨¡æ¿ï¼ˆåŒ…å«æƒé™æ§åˆ¶ï¼‰
    public static final String USER_ORDERS = 
        "SELECT o.id, o.amount, o.status, o.created_at " +
        "FROM orders o " +
        "WHERE o.user_id = ? AND o.created_at >= ?";
    
    // å®‰å…¨çš„æœç´¢æ¨¡æ¿
    public static final String SEARCH_PRODUCTS = 
        "SELECT p.id, p.name, p.price " +
        "FROM products p " +
        "WHERE p.status = 'published' " +
        "AND (p.name LIKE ? OR p.description LIKE ?) " +
        "ORDER BY p.created_at DESC " +
        "LIMIT ?";
        
    // æ¨¡æ¿ä½¿ç”¨ç¤ºä¾‹
    public List<Product> searchProducts(String keyword, int limit) {
        String searchPattern = "%" + sanitizeSearchKeyword(keyword) + "%";
        return jdbcTemplate.query(SEARCH_PRODUCTS,
                                 new Object[]{searchPattern, searchPattern, limit},
                                 new ProductRowMapper());
    }
}
```

### 6.3 å­˜å‚¨è¿‡ç¨‹å®‰å…¨è®¾è®¡


**ğŸ”¸ å®‰å…¨çš„å­˜å‚¨è¿‡ç¨‹å®è·µ**
```sql
-- å®‰å…¨çš„ç”¨æˆ·æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE GetUserSecure(
    IN p_user_id BIGINT,
    IN p_requesting_user_id BIGINT
)
READS SQL DATA
DETERMINISTIC
SQL SECURITY DEFINER
BEGIN
    DECLARE user_count INT DEFAULT 0;
    DECLARE access_allowed BOOLEAN DEFAULT FALSE;
    
    -- å‚æ•°éªŒè¯
    IF p_user_id IS NULL OR p_user_id <= 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'æ— æ•ˆçš„ç”¨æˆ·ID';
    END IF;
    
    -- æƒé™æ£€æŸ¥
    SELECT COUNT(*) INTO user_count 
    FROM users 
    WHERE id = p_requesting_user_id AND (role = 'ADMIN' OR id = p_user_id);
    
    IF user_count = 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'æ— æƒé™è®¿é—®è¯¥ç”¨æˆ·æ•°æ®';
    END IF;
    
    -- å®‰å…¨æŸ¥è¯¢
    SELECT id, name, email, created_at
    FROM users 
    WHERE id = p_user_id AND status = 'active';
    
END //
DELIMITER ;
```

### 6.4 è§†å›¾å±‚å®‰å…¨æ§åˆ¶


**ğŸ”¸ å®‰å…¨è§†å›¾è®¾è®¡**
```sql
-- åˆ›å»ºå®‰å…¨çš„ç”¨æˆ·ä¿¡æ¯è§†å›¾
CREATE VIEW user_safe_view AS
SELECT 
    id,
    name,
    CONCAT(LEFT(email, 2), '***@', SUBSTRING_INDEX(email, '@', -1)) as masked_email,
    created_at,
    status
FROM users
WHERE status = 'active';

-- åŸºäºç”¨æˆ·è§’è‰²çš„åŠ¨æ€è§†å›¾
CREATE VIEW user_role_view AS  
SELECT 
    u.id,
    u.name,
    CASE 
        WHEN @current_user_role = 'ADMIN' THEN u.email
        WHEN u.id = @current_user_id THEN u.email
        ELSE CONCAT(LEFT(u.email, 2), '***')
    END as email,
    u.created_at
FROM users u
WHERE u.status = 'active'
    AND (
        @current_user_role = 'ADMIN' 
        OR u.id = @current_user_id
        OR u.privacy_level = 'public'
    );
```

---

## 7. ğŸ› ï¸ é˜²æŠ¤å·¥å…·ä¸æŠ€æœ¯


### 7.1 Webåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰


**ğŸ”¸ WAFåœ¨SQLæ³¨å…¥é˜²æŠ¤ä¸­çš„ä½œç”¨**
```
WAFé˜²æŠ¤å±‚æ¬¡ï¼š

HTTPè¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WAFæ£€æµ‹å±‚                        â”‚
â”‚ â€¢ ç‰¹å¾åŒ¹é…ï¼šæ£€æµ‹å·²çŸ¥æ”»å‡»æ¨¡å¼      â”‚
â”‚ â€¢ å¼‚å¸¸æ£€æµ‹ï¼šè¯†åˆ«å¼‚å¸¸è¯·æ±‚è¡Œä¸º      â”‚  
â”‚ â€¢ é¢‘ç‡é™åˆ¶ï¼šé˜²æ­¢æš´åŠ›æ”»å‡»         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ é€šè¿‡æ£€æµ‹
åº”ç”¨æœåŠ¡å™¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å®‰å…¨å±‚                       â”‚
â”‚ â€¢ è¾“å…¥éªŒè¯ï¼šç™½åå•+é»‘åå•è¿‡æ»¤     â”‚
â”‚ â€¢ å‚æ•°åŒ–æŸ¥è¯¢ï¼šé˜²æ­¢SQLæ³¨å…¥        â”‚
â”‚ â€¢ æƒé™éªŒè¯ï¼šæ£€æŸ¥ç”¨æˆ·æƒé™         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ éªŒè¯é€šè¿‡
æ•°æ®åº“æœåŠ¡å™¨
```

**ğŸ”¸ WAFè§„åˆ™é…ç½®ç¤ºä¾‹**
```
å¸¸è§SQLæ³¨å…¥æ£€æµ‹è§„åˆ™ï¼š

è§„åˆ™1ï¼šæ£€æµ‹SQLå…³é”®è¯ç»„åˆ
Pattern: (?i)(union.*select|select.*from|insert.*into)
Action: é˜»æ­¢è¯·æ±‚ï¼Œè®°å½•æ—¥å¿—

è§„åˆ™2ï¼šæ£€æµ‹æ³¨é‡Šç¬¦å·
Pattern: (?i)(--|\#|\/\*|\*\/)
Action: é˜»æ­¢è¯·æ±‚ï¼Œè®°å½•æ—¥å¿—

è§„åˆ™3ï¼šæ£€æµ‹å¤šè¯­å¥æ‰§è¡Œ
Pattern: (?i)(;.*?(drop|delete|insert|update))
Action: é˜»æ­¢è¯·æ±‚ï¼Œç«‹å³å‘Šè­¦

è§„åˆ™4ï¼šæ£€æµ‹ç¼–ç ç»•è¿‡
Pattern: (?i)(%27|%3b|%23|%2d%2d)
Action: è§£ç åé‡æ–°æ£€æµ‹
```

### 7.2 è‡ªåŠ¨åŒ–å®‰å…¨æ‰«æ


**ğŸ”¸ SQLæ³¨å…¥æ‰«æå·¥å…·**
```bash
# ä½¿ç”¨sqlmapè¿›è¡Œæ³¨å…¥æµ‹è¯•
sqlmap -u "http://example.com/search?q=test" \
       --data="username=admin&password=123" \
       --level=3 \
       --risk=2 \
       --batch

# æ‰«æç»“æœåˆ†æ
Parameter: username (POST)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: username=admin' AND 1=1-- &password=123

Parameter: q (GET)  
    Type: UNION query
    Title: MySQL UNION query (NULL) - 5 columns
    Payload: q=test' UNION ALL SELECT NULL,CONCAT(username,0x3a,password),NULL,NULL,NULL FROM admin_users-- 
```

**ğŸ”¸ ä»£ç é™æ€åˆ†æ**
```java
// ä»£ç å®¡è®¡ä¸­éœ€è¦é‡ç‚¹æ£€æŸ¥çš„æ¨¡å¼

// å±é™©æ¨¡å¼1ï¼šå­—ç¬¦ä¸²æ‹¼æ¥æ„å»ºSQL
String sql = "SELECT * FROM users WHERE name = '" + userName + "'";

// å±é™©æ¨¡å¼2ï¼šåŠ¨æ€è¡¨åæˆ–åˆ—å
String sql = "SELECT * FROM " + tableName + " WHERE id = ?";

// å±é™©æ¨¡å¼3ï¼šä¸å—æ§åˆ¶çš„ORDER BY
String sql = "SELECT * FROM users ORDER BY " + sortColumn;

// å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆ
public String buildSortClause(String sortColumn) {
    // ç™½åå•éªŒè¯
    Set<String> allowedColumns = Set.of("id", "name", "created_at");
    if (!allowedColumns.contains(sortColumn)) {
        sortColumn = "id";  // é»˜è®¤æ’åº
    }
    return "ORDER BY " + sortColumn;
}
```

### 7.3 å®æ—¶ç›‘æ§ä¸å‘Šè­¦


**ğŸ”¸ SQLæ³¨å…¥æ£€æµ‹ç›‘æ§**
```java
public class SQLInjectionMonitor {
    
    // å®æ—¶æ£€æµ‹å¯ç–‘æŸ¥è¯¢
    @EventListener
    public void onSQLExecution(SQLExecutionEvent event) {
        String sql = event.getSql();
        
        // æ£€æµ‹å¯ç–‘æ¨¡å¼
        if (containsSuspiciousPatterns(sql)) {
            SecurityAlert alert = SecurityAlert.builder()
                .alertType(AlertType.SQL_INJECTION_ATTEMPT)
                .sourceIP(event.getClientIP())
                .sqlStatement(sql)
                .timestamp(event.getTimestamp())
                .severity(calculateSeverity(sql))
                .build();
                
            sendSecurityAlert(alert);
        }
        
        // è®°å½•æŸ¥è¯¢æŒ‡çº¹
        recordQueryFingerprint(event);
    }
    
    private boolean containsSuspiciousPatterns(String sql) {
        String upperSQL = sql.toUpperCase();
        
        // æ£€æµ‹å¤šè¯­å¥æ‰§è¡Œ
        if (upperSQL.contains(";") && 
           (upperSQL.contains("DROP") || upperSQL.contains("DELETE"))) {
            return true;
        }
        
        // æ£€æµ‹è”åˆæŸ¥è¯¢æ³¨å…¥
        if (upperSQL.contains("UNION") && 
            upperSQL.contains("SELECT")) {
            return true;
        }
        
        // æ£€æµ‹æ³¨é‡Šç¬¦å·
        if (upperSQL.contains("--") || upperSQL.contains("/*")) {
            return true;
        }
        
        return false;
    }
}
```

---

## 8. ğŸ¯ æœ€ä½³å®è·µæŒ‡å¯¼


### 8.1 å¼€å‘é˜¶æ®µå®‰å…¨å®è·µ


**ğŸ”¸ å®‰å…¨ç¼–ç è§„èŒƒ**
```java
// æ¨èçš„å®‰å…¨æŸ¥è¯¢æœåŠ¡ç±»
@Service
public class SecureUserService {
    
    private final JdbcTemplate jdbcTemplate;
    private final InputValidator validator;
    private final PermissionChecker permissionChecker;
    
    public User getUserById(Long id) {
        // 1. è¾“å…¥éªŒè¯
        if (id == null || id <= 0) {
            throw new ValidationException("æ— æ•ˆçš„ç”¨æˆ·ID");
        }
        
        // 2. æƒé™æ£€æŸ¥
        if (!permissionChecker.canAccessUser(id)) {
            throw new AccessDeniedException("æ— æƒé™è®¿é—®è¯¥ç”¨æˆ·");
        }
        
        // 3. å®‰å…¨æŸ¥è¯¢
        String sql = "SELECT id, name, email FROM users WHERE id = ? AND status = 'active'";
        
        try {
            return jdbcTemplate.queryForObject(sql, new Object[]{id}, new UserRowMapper());
        } catch (EmptyResultDataAccessException e) {
            return null;  // ç”¨æˆ·ä¸å­˜åœ¨
        }
    }
    
    public List<User> searchUsers(String keyword) {
        // 1. è¾“å…¥éªŒè¯å’Œæ¸…ç†
        if (keyword == null || keyword.trim().isEmpty()) {
            return new ArrayList<>();
        }
        
        String cleanKeyword = validator.sanitizeSearchKeyword(keyword);
        if (cleanKeyword.length() < 2) {
            throw new ValidationException("æœç´¢å…³é”®è¯è‡³å°‘2ä¸ªå­—ç¬¦");
        }
        
        // 2. æ„å»ºå®‰å…¨æŸ¥è¯¢
        String sql = "SELECT id, name FROM users " +
                    "WHERE status = 'active' AND name LIKE ? " +
                    "ORDER BY created_at DESC LIMIT 50";
        
        String searchPattern = "%" + cleanKeyword + "%";
        return jdbcTemplate.query(sql, new Object[]{searchPattern}, new UserRowMapper());
    }
}
```

### 8.2 é…ç½®å®‰å…¨æœ€ä½³å®è·µ


**ğŸ”¸ MySQLå®‰å…¨é…ç½®**
```sql
-- æ•°æ®åº“å®‰å…¨é…ç½®
SET GLOBAL sql_mode = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';

-- ç¦ç”¨å±é™©åŠŸèƒ½
SET GLOBAL local_infile = 0;  -- ç¦æ­¢LOAD DATA LOCAL INFILE
SET GLOBAL general_log = 1;   -- å¯ç”¨æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 1; -- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—

-- è®¾ç½®æŸ¥è¯¢é™åˆ¶
SET GLOBAL max_connections = 1000;        -- é™åˆ¶è¿æ¥æ•°
SET GLOBAL max_user_connections = 50;     -- å•ç”¨æˆ·è¿æ¥é™åˆ¶  
SET GLOBAL query_cache_size = 268435456;  -- å¯ç”¨æŸ¥è¯¢ç¼“å­˜

-- å¯†ç ç­–ç•¥
SET GLOBAL validate_password.policy = 'STRONG';
SET GLOBAL validate_password.length = 12;
```

**ğŸ”¸ åº”ç”¨é…ç½®å®‰å…¨**
```properties
# æ•°æ®åº“è¿æ¥å®‰å…¨é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/myapp?useSSL=true&serverTimezone=UTC
spring.datasource.username=app_user
spring.datasource.password=${DB_PASSWORD}  # ç¯å¢ƒå˜é‡

# è¿æ¥æ± å®‰å…¨é…ç½®
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.max-lifetime=1800000

# JPAå®‰å…¨é…ç½®
spring.jpa.hibernate.ddl-auto=validate  # ç¦æ­¢è‡ªåŠ¨å»ºè¡¨
spring.jpa.show-sql=false  # ç”Ÿäº§ç¯å¢ƒç¦ç”¨SQLæ—¥å¿—
```

### 8.3 ä»£ç å®¡è®¡æ£€æŸ¥æ¸…å•


**ğŸ”¸ SQLæ³¨å…¥é£é™©æ£€æŸ¥**
```
ä»£ç å®¡è®¡é‡ç‚¹ï¼š

1. å­—ç¬¦ä¸²æ‹¼æ¥æ£€æŸ¥
   âŒ "SELECT * FROM " + tableName
   âŒ "WHERE name = '" + name + "'"
   âœ… "SELECT * FROM users WHERE name = ?"

2. åŠ¨æ€SQLæ„å»ºæ£€æŸ¥
   âŒ ç”¨æˆ·è¾“å…¥ç›´æ¥ä½œä¸ºè¡¨åæˆ–åˆ—å
   âŒ æœªéªŒè¯çš„ORDER BYå­—æ®µ
   âœ… ç™½åå•éªŒè¯æ‰€æœ‰åŠ¨æ€éƒ¨åˆ†

3. å­˜å‚¨è¿‡ç¨‹æ£€æŸ¥
   âŒ ä½¿ç”¨CONCATæ„å»ºåŠ¨æ€SQL
   âŒ ä½¿ç”¨PREPARE...EXECUTEæ‰§è¡ŒåŠ¨æ€SQL
   âœ… ä½¿ç”¨å›ºå®šçš„SQLç»“æ„

4. æƒé™æ£€æŸ¥
   âŒ æ•°æ®åº“ç”¨æˆ·æƒé™è¿‡å¤§
   âŒ ç¼ºå°‘åº”ç”¨å±‚æƒé™éªŒè¯
   âœ… æœ€å°æƒé™+å¤šå±‚éªŒè¯
```

### 8.4 å®‰å…¨æµ‹è¯•æ–¹æ³•


**ğŸ”¸ æ¸—é€æµ‹è¯•æ–¹æ¡ˆ**
```
SQLæ³¨å…¥æµ‹è¯•ç”¨ä¾‹ï¼š

åŸºç¡€æ³¨å…¥æµ‹è¯•ï¼š
â€¢ å•å¼•å·æµ‹è¯•ï¼šè¾“å…¥ ' æŸ¥çœ‹æ˜¯å¦æŠ¥é”™
â€¢ åŒå¼•å·æµ‹è¯•ï¼šè¾“å…¥ " æŸ¥çœ‹ååº”
â€¢ æ•°å­—æ³¨å…¥ï¼šåœ¨æ•°å­—å‚æ•°ä¸­è¾“å…¥ 1' OR '1'='1

é«˜çº§æ³¨å…¥æµ‹è¯•ï¼š
â€¢ ç›²æ³¨æµ‹è¯•ï¼šä½¿ç”¨SLEEP()å‡½æ•°æ£€æµ‹
â€¢ è”åˆæŸ¥è¯¢ï¼šå°è¯•UNION SELECTè·å–é¢å¤–æ•°æ®
â€¢ é”™è¯¯æ³¨å…¥ï¼šæ•…æ„è§¦å‘é”™è¯¯è·å–ç³»ç»Ÿä¿¡æ¯

è‡ªåŠ¨åŒ–æµ‹è¯•ï¼š
â€¢ ä½¿ç”¨sqlmapç­‰å·¥å…·å…¨é¢æ‰«æ
â€¢ é›†æˆåˆ°CI/CDæµç¨‹ä¸­
â€¢ å®šæœŸè¿›è¡Œå®‰å…¨å›å½’æµ‹è¯•
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SQLæ³¨å…¥æœ¬è´¨ï¼šç”¨æˆ·è¾“å…¥è¢«è¯¯å½“ä½œSQLä»£ç æ‰§è¡Œçš„å®‰å…¨æ¼æ´
ğŸ”¸ å‚æ•°åŒ–æŸ¥è¯¢ï¼šå°†SQLç»“æ„ä¸æ•°æ®åˆ†ç¦»ï¼Œé˜²æ­¢æ³¨å…¥çš„æ ¹æœ¬æ–¹æ³•
ğŸ”¸ è¾“å…¥éªŒè¯ç­–ç•¥ï¼šç™½åå•éªŒè¯ä¸ºä¸»ï¼Œé»‘åå•è¿‡æ»¤ä¸ºè¾…çš„å¤šå±‚é˜²æŠ¤
ğŸ”¸ æƒé™æ§åˆ¶åŸåˆ™ï¼šæœ€å°æƒé™+æ·±åº¦é˜²æŠ¤+å®¡è®¡è·Ÿè¸ª
ğŸ”¸ å®‰å…¨è®¾è®¡ç†å¿µï¼šé›¶ä¿¡ä»»åŸåˆ™ï¼Œæ‰€æœ‰è¾“å…¥éƒ½ä¸å¯ä¿¡
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆå‚æ•°åŒ–æŸ¥è¯¢èƒ½é˜²æ­¢SQLæ³¨å…¥**
```
æ ¹æœ¬åŸç†ï¼š
â€¢ SQLç»“æ„é¢„ç¼–è¯‘ï¼šæŸ¥è¯¢é€»è¾‘åœ¨ç¼–è¯‘æ—¶ç¡®å®š
â€¢ å‚æ•°åç»‘å®šï¼šç”¨æˆ·è¾“å…¥åªèƒ½ä½œä¸ºæ•°æ®å€¼
â€¢ ç±»å‹å®‰å…¨ï¼šæ•°æ®åº“å¼•æ“åŒºåˆ†ä»£ç å’Œæ•°æ®
â€¢ è¯­æ³•éš”ç¦»ï¼šå‚æ•°å€¼ä¸ä¼šæ”¹å˜SQLè¯­æ³•ç»“æ„

ç±»æ¯”ç†è§£ï¼š
å°±åƒé“¶è¡Œè½¬è´¦å•æœ‰å›ºå®šæ ¼å¼ï¼Œä½ åªèƒ½å¡«å†™æ”¶æ¬¾äººå’Œé‡‘é¢ï¼Œ
ä¸èƒ½ä¿®æ”¹è½¬è´¦å•çš„åŸºæœ¬ç»“æ„å’Œä¸šåŠ¡é€»è¾‘ã€‚
```

**ğŸ”¹ è¾“å…¥éªŒè¯çš„å±‚æ¬¡åŒ–é˜²æŠ¤æ€æƒ³**
```
ä¸ºä»€ä¹ˆéœ€è¦å¤šå±‚éªŒè¯ï¼š
â€¢ å‰ç«¯éªŒè¯ï¼šæå‡ç”¨æˆ·ä½“éªŒï¼Œå¿«é€Ÿåé¦ˆ
â€¢ åº”ç”¨å±‚éªŒè¯ï¼šä¸šåŠ¡é€»è¾‘å®‰å…¨ï¼Œä¸èƒ½è¢«ç»•è¿‡
â€¢ æ•°æ®åº“éªŒè¯ï¼šæœ€åä¸€é“é˜²çº¿ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§

æ·±åº¦é˜²æŠ¤åŸç†ï¼š
å•ä¸€é˜²æŠ¤æªæ–½å¯èƒ½è¢«ç»•è¿‡ï¼Œå¤šå±‚é˜²æŠ¤ç¡®ä¿å³ä½¿æŸå±‚å¤±æ•ˆï¼Œ
å…¶ä»–å±‚ä»èƒ½æä¾›ä¿æŠ¤ã€‚
```

**ğŸ”¹ æƒé™æ§åˆ¶çš„ç²’åº¦é€‰æ‹©**
```
æƒé™ç²’åº¦æƒè¡¡ï¼š
â€¢ ç²—ç²’åº¦ï¼šå®ç°ç®€å•ï¼Œä½†å®‰å…¨æ€§è¾ƒä½
â€¢ ç»†ç²’åº¦ï¼šå®‰å…¨æ€§é«˜ï¼Œä½†å¤æ‚åº¦å’Œæ€§èƒ½å¼€é”€å¤§

å®é™…é€‰æ‹©åŸåˆ™ï¼š
â€¢ æ ¸å¿ƒæ•æ„Ÿæ•°æ®ï¼šä½¿ç”¨æœ€ç»†ç²’åº¦æ§åˆ¶
â€¢ ä¸€èˆ¬ä¸šåŠ¡æ•°æ®ï¼šä½¿ç”¨é€‚ä¸­ç²’åº¦
â€¢ å…¬å¼€æ•°æ®ï¼šä½¿ç”¨ç²—ç²’åº¦æ§åˆ¶

æƒé™è®¾è®¡è¦ç‚¹ï¼š
â€¢ é»˜è®¤æ‹’ç»ï¼šæ²¡æœ‰æ˜ç¡®æˆæƒå°±æ‹’ç»è®¿é—®
â€¢ æƒé™åˆ†ç¦»ï¼šä¸åŒè§’è‰²æœ‰ä¸åŒæƒé™
â€¢ å®šæœŸå®¡æ ¸ï¼šåŠæ—¶å›æ”¶ä¸éœ€è¦çš„æƒé™
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ”¸ å¼€å‘å›¢é˜Ÿå®‰å…¨åŸ¹è®­é‡ç‚¹**
- **å®‰å…¨æ„è¯†**ï¼šç†è§£SQLæ³¨å…¥çš„å±å®³å’Œå½±å“
- **ç¼–ç è§„èŒƒ**ï¼šæŒæ¡å‚æ•°åŒ–æŸ¥è¯¢çš„æ­£ç¡®ä½¿ç”¨
- **æµ‹è¯•æ–¹æ³•**ï¼šå­¦ä¼šåŸºæœ¬çš„å®‰å…¨æµ‹è¯•æŠ€å·§
- **åº”æ€¥å“åº”**ï¼šå‘ç°å®‰å…¨é—®é¢˜æ—¶çš„å¤„ç†æµç¨‹

**ğŸ”¸ é¡¹ç›®å®‰å…¨æ£€æŸ¥æ¸…å•**
- **ä»£ç å®¡è®¡**ï¼šæ£€æŸ¥æ‰€æœ‰SQLæ‹¼æ¥å’ŒåŠ¨æ€æŸ¥è¯¢
- **æƒé™é…ç½®**ï¼šéªŒè¯æ•°æ®åº“ç”¨æˆ·æƒé™æœ€å°åŒ–
- **è¾“å…¥éªŒè¯**ï¼šç¡®ä¿æ‰€æœ‰å¤–éƒ¨è¾“å…¥éƒ½ç»è¿‡éªŒè¯
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹SQLæ³¨å…¥æ”»å‡»æ£€æµ‹æœºåˆ¶

**ğŸ”¸ å®‰å…¨è¿ç»´å»ºè®®**
- **å®šæœŸæ›´æ–°**ï¼šåŠæ—¶æ›´æ–°æ•°æ®åº“å’Œæ¡†æ¶ç‰ˆæœ¬
- **å®‰å…¨æ‰«æ**ï¼šå®šæœŸè¿›è¡Œæ¼æ´æ‰«æå’Œæ¸—é€æµ‹è¯•
- **æ—¥å¿—åˆ†æ**ï¼šå»ºç«‹å®‰å…¨æ—¥å¿—åˆ†æå’Œå‘Šè­¦ç³»ç»Ÿ
- **åº”æ€¥é¢„æ¡ˆ**ï¼šåˆ¶å®šå®‰å…¨äº‹ä»¶å“åº”æµç¨‹

### 9.4 å¸¸è§é—®é¢˜è§£ç­”


**Q1ï¼šä½¿ç”¨äº†ORMæ¡†æ¶æ˜¯å¦å°±å®‰å…¨äº†ï¼Ÿ**
```
ç­”ï¼šORMæ¡†æ¶æä¾›äº†ä¸€å®šä¿æŠ¤ï¼Œä½†ä¸æ˜¯ä¸‡èƒ½çš„

ORMçš„å®‰å…¨ä¼˜åŠ¿ï¼š
â€¢ è‡ªåŠ¨å‚æ•°åŒ–ï¼šå¤§éƒ¨åˆ†æŸ¥è¯¢è‡ªåŠ¨ä½¿ç”¨å‚æ•°åŒ–
â€¢ ç±»å‹å®‰å…¨ï¼šå¼ºç±»å‹è¯­è¨€æä¾›é¢å¤–ä¿æŠ¤
â€¢ æŠ½è±¡å±‚ï¼šå‡å°‘ç›´æ¥å†™SQLçš„æœºä¼š

ORMçš„å®‰å…¨é™·é˜±ï¼š
â€¢ åŠ¨æ€æŸ¥è¯¢ï¼šä»å¯èƒ½å­˜åœ¨æ³¨å…¥é£é™©
â€¢ åŸç”ŸSQLï¼šç»•è¿‡ORMä¿æŠ¤æœºåˆ¶
â€¢ é…ç½®é”™è¯¯ï¼šä¸å½“é…ç½®å¯¼è‡´å®‰å…¨æ¼æ´

å»ºè®®ï¼šä½¿ç”¨ORMä½†ä»è¦éµå¾ªå®‰å…¨ç¼–ç è§„èŒƒ
```

**Q2ï¼šå‚æ•°åŒ–æŸ¥è¯¢æœ‰æ€§èƒ½å½±å“å—ï¼Ÿ**
```
ç­”ï¼šè½»å¾®çš„æ€§èƒ½å¼€é”€ï¼Œä½†å®‰å…¨æ”¶ç›Šè¿œå¤§äºæ€§èƒ½æˆæœ¬

æ€§èƒ½å½±å“åˆ†æï¼š
â€¢ é¢„ç¼–è¯‘å¼€é”€ï¼šé¦–æ¬¡ç¼–è¯‘SQLéœ€è¦é¢å¤–æ—¶é—´
â€¢ å‚æ•°ç»‘å®šï¼šæ¯”å­—ç¬¦ä¸²æ‹¼æ¥ç¨æ…¢
â€¢ æ‰§è¡Œè®¡åˆ’ç¼“å­˜ï¼šé‡å¤æŸ¥è¯¢æ€§èƒ½æ›´å¥½

å®é™…æµ‹è¯•ç»“æœï¼š
â€¢ é¦–æ¬¡æ‰§è¡Œï¼šæ…¢5-10%
â€¢ é‡å¤æ‰§è¡Œï¼šå¿«10-20%ï¼ˆç”±äºç¼“å­˜ï¼‰
â€¢ æ•´ä½“å½±å“ï¼š< 1%

ç»“è®ºï¼šå¾®å°çš„æ€§èƒ½ä»£ä»·æ¢å–å·¨å¤§çš„å®‰å…¨æ”¶ç›Š
```

**Q3ï¼šå¦‚ä½•å¤„ç†åŠ¨æ€æŸ¥è¯¢éœ€æ±‚ï¼Ÿ**
```
ç­”ï¼šä½¿ç”¨å®‰å…¨çš„åŠ¨æ€æŸ¥è¯¢æ„å»ºæ–¹æ³•

å®‰å…¨çš„åŠ¨æ€æŸ¥è¯¢ç­–ç•¥ï¼š
â€¢ æŸ¥è¯¢æ„å»ºå™¨ï¼šæä¾›ç±»å‹å®‰å…¨çš„æŸ¥è¯¢æ„å»º
â€¢ ç™½åå•éªŒè¯ï¼šåŠ¨æ€éƒ¨åˆ†åªèƒ½ä»é¢„å®šä¹‰åˆ—è¡¨é€‰æ‹©
â€¢ æ¨¡æ¿æ–¹æ³•ï¼šé¢„å®šä¹‰æŸ¥è¯¢æ¨¡æ¿ï¼Œåªå…è®¸å‚æ•°å˜åŒ–
â€¢ æƒé™éªŒè¯ï¼šç¡®ä¿ç”¨æˆ·æœ‰æƒæ‰§è¡ŒåŠ¨æ€æŸ¥è¯¢

ç¤ºä¾‹ï¼š
// å®‰å…¨çš„åŠ¨æ€æ’åº
Map<String, String> allowedSorts = Map.of(
    "name", "name ASC",
    "date", "created_at DESC",
    "score", "score DESC"
);
String orderBy = allowedSorts.getOrDefault(userInput, "id ASC");
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- SQLæ³¨å…¥æ˜¯æ•°æ®å®‰å…¨çš„å¤´å·å¨èƒï¼Œå¿…é¡»é«˜åº¦é‡è§†
- å‚æ•°åŒ–æŸ¥è¯¢æ˜¯é˜²æŠ¤SQLæ³¨å…¥çš„æ ¹æœ¬å’Œæœ€æœ‰æ•ˆæ–¹æ³•
- å®‰å…¨è®¾è®¡è¦éµå¾ªé›¶ä¿¡ä»»å’Œæ·±åº¦é˜²æŠ¤åŸåˆ™
- è¾“å…¥éªŒè¯ã€æƒé™æ§åˆ¶ã€ç›‘æ§å‘Šè­¦ç¼ºä¸€ä¸å¯