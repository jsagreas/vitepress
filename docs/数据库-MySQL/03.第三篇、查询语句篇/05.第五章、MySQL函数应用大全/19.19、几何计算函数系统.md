---
title: 19ã€å‡ ä½•è®¡ç®—å‡½æ•°ç³»ç»Ÿ
---
## ğŸ“š ç›®å½•

1. [å‡ ä½•æ•°æ®ç±»å‹åŸºç¡€](#1-å‡ ä½•æ•°æ®ç±»å‹åŸºç¡€)
2. [å‡ ä½•å¯¹è±¡åˆ›å»ºå‡½æ•°](#2-å‡ ä½•å¯¹è±¡åˆ›å»ºå‡½æ•°)
3. [å‡ ä½•å…³ç³»åˆ¤æ–­å‡½æ•°](#3-å‡ ä½•å…³ç³»åˆ¤æ–­å‡½æ•°)
4. [å‡ ä½•è®¡ç®—å‡½æ•°è¯¦è§£](#4-å‡ ä½•è®¡ç®—å‡½æ•°è¯¦è§£)
5. [åæ ‡ç³»è½¬æ¢å¤„ç†](#5-åæ ‡ç³»è½¬æ¢å¤„ç†)
6. [ç©ºé—´ç´¢å¼•ä¼˜åŒ–åº”ç”¨](#6-ç©ºé—´ç´¢å¼•ä¼˜åŒ–åº”ç”¨)
7. [å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹](#7-å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹)
8. [æ€§èƒ½ä¼˜åŒ–æŠ€å·§](#8-æ€§èƒ½ä¼˜åŒ–æŠ€å·§)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å‡ ä½•æ•°æ®ç±»å‹åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯å‡ ä½•æ•°æ®ç±»å‹


**ğŸ”¸ é€šä¿—ç†è§£**
```
å‡ ä½•æ•°æ®ç±»å‹å°±åƒåœ¨åœ°å›¾ä¸Šåšæ ‡è®°ï¼š
â€¢ ç‚¹ï¼ˆPOINTï¼‰ï¼šä¸€ä¸ªä½ç½®ï¼Œæ¯”å¦‚"åŒ—äº¬å¸‚ä¸­å¿ƒ"
â€¢ çº¿ï¼ˆLINESTRINGï¼‰ï¼šä¸€æ¡è·¯å¾„ï¼Œæ¯”å¦‚"ä»å®¶åˆ°å…¬å¸çš„è·¯çº¿"
â€¢ é¢ï¼ˆPOLYGONï¼‰ï¼šä¸€ä¸ªåŒºåŸŸï¼Œæ¯”å¦‚"åŒ—äº¬äº”ç¯å†…çš„åŒºåŸŸ"
â€¢ é›†åˆï¼šå¤šä¸ªå‡ ä½•å¯¹è±¡çš„ç»„åˆï¼Œæ¯”å¦‚"æ‰€æœ‰åœ°é“ç«™ç‚¹çš„é›†åˆ"

MySQLå¯ä»¥å­˜å‚¨å’Œè®¡ç®—è¿™äº›å‡ ä½•ä¿¡æ¯ï¼Œå°±åƒGPSå¯¼èˆªä¸€æ ·ï¼
```

**ğŸ“‹ å‡ ä½•æ•°æ®ç±»å‹åˆ†ç±»**
```
åŸºç¡€å‡ ä½•ç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‡ ä½•ç±»å‹å±‚æ¬¡                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç‚¹ç±»å‹    â”‚         POINT             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   çº¿ç±»å‹    â”‚      LINESTRING           â”‚
â”‚             â”‚      LINEARRING           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é¢ç±»å‹    â”‚       POLYGON             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é›†åˆç±»å‹   â”‚     MULTIPOINT            â”‚
â”‚             â”‚   MULTILINESTRING         â”‚
â”‚             â”‚    MULTIPOLYGON           â”‚
â”‚             â”‚  GEOMETRYCOLLECTION       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 å‡ ä½•æ•°æ®ç±»å‹è¯¦è§£


**ğŸ“ POINTï¼ˆç‚¹ç±»å‹ï¼‰**
```sql
-- åˆ›å»ºç‚¹æ•°æ®ï¼šPOINT(ç»åº¦, çº¬åº¦)
SET @beijing_center = ST_GeomFromText('POINT(116.3974 39.9093)');

-- åˆ›å»ºåœ°æ ‡è¡¨
CREATE TABLE landmarks (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    location POINT NOT NULL,
    SPATIAL INDEX idx_location (location)
);

INSERT INTO landmarks (name, location) VALUES
('å¤©å®‰é—¨', ST_GeomFromText('POINT(116.3974 39.9093)')),
('æ•…å®«', ST_GeomFromText('POINT(116.3979 39.9163)'));
```

**ğŸ“ LINESTRINGï¼ˆçº¿å­—ç¬¦ä¸²ï¼‰**
```sql
-- åˆ›å»ºçº¿è·¯æ•°æ®ï¼šå¤šä¸ªåæ ‡ç‚¹è¿æˆçº¿
CREATE TABLE bus_routes (
    route_id VARCHAR(20) PRIMARY KEY,
    route_name VARCHAR(100),
    path LINESTRING NOT NULL,
    SPATIAL INDEX idx_path (path)
);

INSERT INTO bus_routes (route_id, route_name, path) VALUES
('001', 'å¤©å®‰é—¨-ç‹åºœäº•çº¿', ST_GeomFromText('LINESTRING(
    116.3974 39.9093,
    116.3517 39.9042,
    116.3687 39.9038
)'));
```

**ğŸ”· POLYGONï¼ˆå¤šè¾¹å½¢ï¼‰**
```sql
-- åˆ›å»ºåŒºåŸŸæ•°æ®ï¼šå°é—­çš„å¤šè¾¹å½¢åŒºåŸŸ
CREATE TABLE districts (
    district_id INT AUTO_INCREMENT PRIMARY KEY,
    district_name VARCHAR(100),
    boundary POLYGON NOT NULL,
    SPATIAL INDEX idx_boundary (boundary)
);

INSERT INTO districts (district_name, boundary) VALUES
('æœé˜³åŒº', ST_GeomFromText('POLYGON((
    116.4000 39.8500,
    116.6000 39.8500,
    116.6000 40.0500,
    116.4000 40.0500,
    116.4000 39.8500
))'));
```

> **ğŸ’¡ ç†è§£è¦ç‚¹ï¼š** å‡ ä½•æ•°æ®ç±»å‹å°±åƒåœ¨åœ°å›¾ä¸Šæ ‡è®°ä½ç½®ã€ç”»çº¿è·¯ã€åœˆåŒºåŸŸï¼ŒMySQLå¯ä»¥å­˜å‚¨è¿™äº›ä¿¡æ¯å¹¶è¿›è¡Œç©ºé—´è®¡ç®—ã€‚

---

## 2. ğŸ”§ å‡ ä½•å¯¹è±¡åˆ›å»ºå‡½æ•°


### 2.1 åŸºç¡€åˆ›å»ºå‡½æ•°


**ğŸ“ ST_GeomFromText() - ä»æ–‡æœ¬åˆ›å»ºå‡ ä½•å¯¹è±¡**
```sql
-- æœ€å¸¸ç”¨çš„å‡ ä½•å¯¹è±¡åˆ›å»ºå‡½æ•°
SELECT 
    ST_GeomFromText('POINT(116.3974 39.9093)') AS point_example,
    ST_GeomFromText('LINESTRING(0 0, 10 10, 20 0)') AS line_example,
    ST_GeomFromText('POLYGON((0 0, 10 0, 10 10, 0 10, 0 0))') AS polygon_example;
```

**ğŸ—ï¸ ST_Point() - ç›´æ¥åˆ›å»ºç‚¹å¯¹è±¡**
```sql
-- æ›´ç®€ä¾¿çš„ç‚¹åˆ›å»ºæ–¹å¼
SELECT 
    ST_Point(116.3974, 39.9093) AS direct_point,
    ST_Equals(
        ST_GeomFromText('POINT(116.3974 39.9093)'),
        ST_Point(116.3974, 39.9093)
    ) AS are_equal;

-- ç”¨æˆ·ç­¾åˆ°åŠŸèƒ½ç¤ºä¾‹
CREATE TABLE user_checkins (
    checkin_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    checkin_location POINT NOT NULL,
    checkin_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    SPATIAL INDEX idx_location (checkin_location)
);

INSERT INTO user_checkins (user_id, checkin_location) VALUES
(1001, ST_Point(116.3974, 39.9093));
```

### 2.2 å¤æ‚å‡ ä½•å¯¹è±¡åˆ›å»º


**ğŸ”— ST_LineFromText() - åˆ›å»ºçº¿å¯¹è±¡**
```sql
-- ä¸“é—¨åˆ›å»ºçº¿å¯¹è±¡
CREATE TABLE delivery_routes (
    route_id INT AUTO_INCREMENT PRIMARY KEY,
    route_name VARCHAR(100),
    route_path LINESTRING NOT NULL,
    distance_km DECIMAL(8,2)
);

INSERT INTO delivery_routes (route_name, route_path) VALUES
('é…é€è·¯çº¿1', ST_LineFromText('LINESTRING(
    116.3974 39.9093,
    116.3517 39.9042,
    116.4180 39.9170
)'));

-- è®¡ç®—è·¯çº¿é•¿åº¦
SELECT route_name, ST_Length(route_path) * 111 AS distance_km 
FROM delivery_routes;
```

**ğŸ¢ ST_PolygonFromText() - åˆ›å»ºå¤šè¾¹å½¢å¯¹è±¡**
```sql
-- åˆ›å»ºå•†åœˆåŒºåŸŸ
CREATE TABLE business_districts (
    district_id INT AUTO_INCREMENT PRIMARY KEY,
    district_name VARCHAR(100),
    coverage_area POLYGON NOT NULL
);

INSERT INTO business_districts (district_name, coverage_area) VALUES
('ç‹åºœäº•å•†åœˆ', ST_PolygonFromText('POLYGON((
    116.3400 39.8950,
    116.3650 39.8950,
    116.3650 39.9150,
    116.3400 39.9150,
    116.3400 39.8950
))'));

-- æŸ¥è¯¢æŸç‚¹æ˜¯å¦åœ¨å•†åœˆå†…
SET @test_location = ST_Point(116.3517, 39.9042);
SELECT district_name FROM business_districts
WHERE ST_Contains(coverage_area, @test_location);
```

### 2.3 å‡ ä½•é›†åˆåˆ›å»º


**ğŸ¯ å¤šç‚¹é›†åˆåˆ›å»º**
```sql
-- è¿é”åº—åˆ†å¸ƒè¡¨
CREATE TABLE chain_stores (
    chain_id INT AUTO_INCREMENT PRIMARY KEY,
    brand_name VARCHAR(100),
    store_locations MULTIPOINT NOT NULL
);

INSERT INTO chain_stores (brand_name, store_locations) VALUES
('æ˜Ÿå·´å…‹', ST_GeomFromText('MULTIPOINT(
    (116.3974 39.9093),
    (116.3517 39.9042),
    (116.4608 39.9042)
)'));

-- æŸ¥è¯¢åº—é“ºæ•°é‡
SELECT brand_name, ST_NumGeometries(store_locations) AS store_count
FROM chain_stores;
```

---

## 3. ğŸ” å‡ ä½•å…³ç³»åˆ¤æ–­å‡½æ•°


### 3.1 åŸºç¡€å…³ç³»åˆ¤æ–­


**ğŸ“ ST_Distance() - è®¡ç®—è·ç¦»**
```sql
-- æ‰¾åˆ°è·ç¦»ç”¨æˆ·æœ€è¿‘çš„å•†åº—
SET @user_location = ST_Point(116.3800, 39.9100);

SELECT 
    name,
    ROUND(ST_Distance(location, @user_location) * 111, 2) AS distance_km
FROM landmarks
ORDER BY ST_Distance(location, @user_location)
LIMIT 3;
```

**ğŸ¯ ST_Within() - åˆ¤æ–­æ˜¯å¦åŒ…å«**
```sql
-- åˆ¤æ–­åœ°æ ‡æ˜¯å¦åœ¨æŒ‡å®šåŒºåŸŸå†…
SELECT 
    l.name,
    d.district_name,
    ST_Within(l.location, d.boundary) AS is_in_district
FROM landmarks l
CROSS JOIN districts d
WHERE ST_Within(l.location, d.boundary);
```

**ğŸ”— ST_Intersects() - åˆ¤æ–­æ˜¯å¦ç›¸äº¤**
```sql
-- åˆ¤æ–­è·¯çº¿æ˜¯å¦ç»è¿‡æŸåŒºåŸŸ
SELECT 
    r.route_name,
    d.district_name,
    ST_Intersects(r.route_path, d.boundary) AS route_passes_through
FROM delivery_routes r
CROSS JOIN districts d
WHERE ST_Intersects(r.route_path, d.boundary);
```

### 3.2 é«˜çº§å…³ç³»åˆ¤æ–­


**ğŸ”„ ST_Contains() - åˆ¤æ–­åŒ…å«å…³ç³»**
```sql
-- æŸ¥æ‰¾åŒºåŸŸå†…çš„æ‰€æœ‰åœ°æ ‡
SELECT 
    d.district_name,
    COUNT(l.id) AS landmark_count,
    GROUP_CONCAT(l.name) AS landmarks
FROM districts d
LEFT JOIN landmarks l ON ST_Contains(d.boundary, l.location)
GROUP BY d.district_id;
```

**âš¡ ST_Equals() - åˆ¤æ–­æ˜¯å¦ç›¸ç­‰**
```sql
-- æ£€æŸ¥é‡å¤ä½ç½®
SELECT 
    l1.name AS location1,
    l2.name AS location2,
    ST_Equals(l1.location, l2.location) AS same_location
FROM landmarks l1
JOIN landmarks l2 ON l1.id < l2.id
WHERE ST_Distance(l1.location, l2.location) < 0.001;
```

**ğŸ”² ST_Touches() - åˆ¤æ–­æ˜¯å¦ç›¸é‚»**
```sql
-- æŸ¥æ‰¾ç›¸é‚»åŒºåŸŸ
SELECT 
    d1.district_name AS district1,
    d2.district_name AS district2,
    ST_Touches(d1.boundary, d2.boundary) AS are_adjacent
FROM districts d1
JOIN districts d2 ON d1.district_id < d2.district_id
WHERE ST_Touches(d1.boundary, d2.boundary);
```

> **ğŸ’¡ å®ç”¨æŠ€å·§ï¼š** å‡ ä½•å…³ç³»åˆ¤æ–­å‡½æ•°æ˜¯GISåº”ç”¨çš„æ ¸å¿ƒï¼Œå¯ä»¥å®ç°"é™„è¿‘çš„å•†å®¶"ã€"é…é€èŒƒå›´"ã€"åŒºåŸŸåˆ†æ"ç­‰åŠŸèƒ½ã€‚

---

## 4. ğŸ“ å‡ ä½•è®¡ç®—å‡½æ•°è¯¦è§£


### 4.1 æµ‹é‡è®¡ç®—å‡½æ•°


**ğŸ“ ST_Length() - è®¡ç®—é•¿åº¦**
```sql
-- è®¡ç®—è·¯çº¿é•¿åº¦å’Œç»Ÿè®¡ä¿¡æ¯
SELECT 
    route_name,
    ROUND(ST_Length(route_path) * 111, 2) AS length_km,
    ST_NumPoints(route_path) AS waypoint_count
FROM delivery_routes;

-- æ›´æ–°è·ç¦»å­—æ®µ
UPDATE delivery_routes 
SET distance_km = ROUND(ST_Length(route_path) * 111, 2);
```

**ğŸ“Š ST_Area() - è®¡ç®—é¢ç§¯**
```sql
-- åˆ†æåŒºåŸŸé¢ç§¯
SELECT 
    district_name,
    ROUND(ST_Area(boundary) * 111 * 111, 2) AS area_km2
FROM districts
ORDER BY ST_Area(boundary) DESC;

-- è®¡ç®—åœ°æ ‡å¯†åº¦
SELECT 
    d.district_name,
    COUNT(l.id) AS landmark_count,
    ROUND(ST_Area(d.boundary) * 111 * 111, 2) AS area_km2,
    ROUND(COUNT(l.id) / (ST_Area(d.boundary) * 111 * 111), 2) AS landmarks_per_km2
FROM districts d
LEFT JOIN landmarks l ON ST_Contains(d.boundary, l.location)
GROUP BY d.district_id;
```

### 4.2 å‡ ä½•å˜æ¢å‡½æ•°


**ğŸ”„ ST_Buffer() - åˆ›å»ºç¼“å†²åŒº**
```sql
-- åˆ›å»ºæœåŠ¡èŒƒå›´
CREATE TABLE store_service_areas AS
SELECT 
    id,
    name,
    location,
    ST_Buffer(location, 0.009) AS service_area_1km,  -- 1å…¬é‡ŒæœåŠ¡èŒƒå›´
    ST_Buffer(location, 0.027) AS service_area_3km   -- 3å…¬é‡ŒæœåŠ¡èŒƒå›´
FROM landmarks;

-- ç»Ÿè®¡æœåŠ¡èŒƒå›´å†…çš„ç”¨æˆ·
SELECT 
    s.name,
    COUNT(u.checkin_id) AS checkins_in_1km
FROM store_service_areas s
LEFT JOIN user_checkins u ON ST_Within(u.checkin_location, s.service_area_1km)
GROUP BY s.id;
```

**ğŸ“ ST_Centroid() - è®¡ç®—å‡ ä½•ä¸­å¿ƒ**
```sql
-- è®¡ç®—åŒºåŸŸä¸­å¿ƒç‚¹
SELECT 
    district_name,
    ST_AsText(ST_Centroid(boundary)) AS center_point,
    ST_X(ST_Centroid(boundary)) AS center_lng,
    ST_Y(ST_Centroid(boundary)) AS center_lat
FROM districts;

-- åˆ›å»ºåŒºåŸŸä¸­å¿ƒåœ°æ ‡
CREATE TABLE district_centers AS
SELECT 
    district_id,
    district_name,
    ST_Centroid(boundary) AS center_location
FROM districts;
```

### 4.3 å‡ ä½•åˆ†æå‡½æ•°


**ğŸ”— ST_Intersection() - è®¡ç®—äº¤é›†**
```sql
-- åˆ†æè·¯çº¿ä¸åŒºåŸŸçš„äº¤é›†
SELECT 
    r.route_name,
    d.district_name,
    ST_Intersects(r.route_path, d.boundary) AS has_intersection,
    ROUND(ST_Length(ST_Intersection(r.route_path, d.boundary)) * 111, 2) AS intersection_km
FROM delivery_routes r
CROSS JOIN districts d
WHERE ST_Intersects(r.route_path, d.boundary);
```

**â– ST_Difference() - è®¡ç®—å·®é›†**
```sql
-- è®¡ç®—åŒºåŸŸæ‰©å±•éƒ¨åˆ†
SELECT 
    district_name,
    ROUND(ST_Area(boundary) * 111 * 111, 2) AS current_area_km2,
    ROUND(ST_Area(ST_Buffer(boundary, 0.01)) * 111 * 111, 2) AS expanded_area_km2,
    ROUND(ST_Area(ST_Difference(ST_Buffer(boundary, 0.01), boundary)) * 111 * 111, 2) AS expansion_km2
FROM districts;
```

---

## 5. ğŸ—ºï¸ åæ ‡ç³»è½¬æ¢å¤„ç†


### 5.1 åæ ‡ç³»åŸºç¡€çŸ¥è¯†


**ğŸ”¸ ä»€ä¹ˆæ˜¯åæ ‡ç³»**
```
åæ ‡ç³»å°±åƒåœ°å›¾çš„"æ ‡å°º"ï¼š
â€¢ WGS84ï¼ˆGPSåæ ‡ç³»ï¼‰ï¼šå…¨çƒå®šä½ç³»ç»Ÿä½¿ç”¨ï¼Œå›½é™…æ ‡å‡†
â€¢ GCJ02ï¼ˆç«æ˜Ÿåæ ‡ç³»ï¼‰ï¼šä¸­å›½åç§»åæ ‡ç³»ï¼Œé«˜å¾·åœ°å›¾ä½¿ç”¨
â€¢ BD09ï¼ˆç™¾åº¦åæ ‡ç³»ï¼‰ï¼šç™¾åº¦åœ°å›¾ä¸“ç”¨åæ ‡ç³»
â€¢ Web Mercatorï¼šç½‘ç»œåœ°å›¾æŠ•å½±ï¼Œé€‚åˆå¹³é¢æ˜¾ç¤º

ä¸åŒåæ ‡ç³»çš„åŒä¸€ä¸ªåœ°ç‚¹ï¼Œåæ ‡æ•°å€¼ä¼šä¸åŒï¼
```

**ğŸ“Š å¸¸ç”¨åæ ‡ç³»å¯¹æ¯”**

| åæ ‡ç³» | **SRID** | **ä½¿ç”¨åœºæ™¯** | **ç‰¹ç‚¹** |
|--------|----------|-------------|---------|
| **WGS84** | `4326` | GPSå®šä½ã€å›½é™…åº”ç”¨ | å…¨çƒæ ‡å‡†ï¼Œæ— åç§» |
| **Web Mercator** | `3857` | ç½‘ç»œåœ°å›¾æ˜¾ç¤º | é€‚åˆå¹³é¢æŠ•å½± |
| **China GCJ02** | `4490` | ä¸­å›½åœ°å›¾åº”ç”¨ | å®˜æ–¹è¦æ±‚åç§» |
| **Beijing 54** | `4214` | ä¸­å›½ä¼ ç»Ÿæµ‹ç»˜ | å†å²åæ ‡ç³» |

### 5.2 åæ ‡ç³»è®¾ç½®å’Œè½¬æ¢


**ğŸŒ ST_SRID() - ç®¡ç†åæ ‡ç³»**
```sql
-- æŸ¥çœ‹å’Œè®¾ç½®åæ ‡ç³»
SELECT name, ST_SRID(location) AS current_srid FROM landmarks;

-- è®¾ç½®åæ ‡ç³»ï¼ˆWGS84ï¼‰
UPDATE landmarks SET location = ST_SetSRID(location, 4326);

-- åˆ›å»ºå¤šåæ ‡ç³»è¡¨
CREATE TABLE locations_multi_srid (
    location_id INT AUTO_INCREMENT PRIMARY KEY,
    location_name VARCHAR(100),
    wgs84_point POINT,      -- WGS84åæ ‡
    web_mercator_point POINT -- Web Mercatoråæ ‡
);
```

### 5.3 çƒé¢è·ç¦»è®¡ç®—


**ğŸ“ ST_Distance_Sphere() - ç²¾ç¡®è·ç¦»è®¡ç®—**
```sql
-- ä½¿ç”¨çƒé¢è·ç¦»ï¼ˆæ›´å‡†ç¡®ï¼‰
SELECT 
    l1.name AS location1,
    l2.name AS location2,
    ROUND(ST_Distance(l1.location, l2.location) * 111000, 2) AS planar_distance_m,
    ROUND(ST_Distance_Sphere(l1.location, l2.location), 2) AS spherical_distance_m
FROM landmarks l1
JOIN landmarks l2 ON l1.id < l2.id;

-- åˆ›å»ºç²¾ç¡®è·ç¦»æŸ¥è¯¢å‡½æ•°
DELIMITER $$
CREATE FUNCTION GetAccurateDistance(point1 POINT, point2 POINT)
RETURNS DECIMAL(10,2)
READS SQL DATA
DETERMINISTIC
BEGIN
    RETURN ST_Distance_Sphere(point1, point2);
END$$
DELIMITER ;
```

---

## 6. ğŸš€ ç©ºé—´ç´¢å¼•ä¼˜åŒ–åº”ç”¨


### 6.1 ç©ºé—´ç´¢å¼•åŸºç¡€


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç©ºé—´ç´¢å¼•**
```
ç©ºé—´ç´¢å¼•å°±åƒå›¾ä¹¦é¦†çš„åˆ†ç±»ç³»ç»Ÿï¼š
â€¢ æ™®é€šç´¢å¼•ï¼šæŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼ˆé€‚åˆä¸€ç»´æ•°æ®ï¼‰
â€¢ ç©ºé—´ç´¢å¼•ï¼šæŒ‰åœ°ç†ä½ç½®åˆ†åŒºï¼ˆé€‚åˆäºŒç»´/ä¸‰ç»´æ•°æ®ï¼‰

ä½œç”¨ï¼šå¿«é€Ÿæ‰¾åˆ°æŸä¸ªåŒºåŸŸå†…çš„æ‰€æœ‰ç‚¹ï¼Œä¼˜åŒ–å‡ ä½•æŸ¥è¯¢æ€§èƒ½
```

**ğŸ”§ åˆ›å»ºå’Œç®¡ç†ç©ºé—´ç´¢å¼•**
```sql
-- åˆ›å»ºç©ºé—´ç´¢å¼•
CREATE TABLE poi_locations (
    poi_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    poi_name VARCHAR(200),
    location POINT NOT NULL,
    SPATIAL INDEX idx_location (location)
);

-- ä¸ºç°æœ‰è¡¨æ·»åŠ ç©ºé—´ç´¢å¼•
ALTER TABLE user_checkins ADD SPATIAL INDEX idx_location (checkin_location);

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
EXPLAIN SELECT * FROM poi_locations 
WHERE ST_Contains(ST_Buffer(ST_Point(116.3974, 39.9093), 0.01), location);
```

### 6.2 ç©ºé—´æŸ¥è¯¢ä¼˜åŒ–


**âš¡ é«˜æ•ˆèŒƒå›´æŸ¥è¯¢**
```sql
-- ä¼˜åŒ–çš„é™„è¿‘æŸ¥è¯¢
SET @center = ST_Point(116.3974, 39.9093);
SET @radius = 0.01;  -- çº¦1å…¬é‡Œ

SELECT 
    poi_name,
    ROUND(ST_Distance_Sphere(location, @center), 0) AS distance_m
FROM poi_locations 
WHERE ST_Contains(ST_Buffer(@center, @radius), location)
ORDER BY ST_Distance_Sphere(location, @center)
LIMIT 20;

-- åˆ›å»ºé™„è¿‘POIæŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE FindNearbyPOIs(
    IN lng DECIMAL(10,6),
    IN lat DECIMAL(10,6),
    IN radius_km DECIMAL(8,2)
)
BEGIN
    SET @center_point = ST_Point(lng, lat);
    SET @radius_deg = radius_km / 111.0;
    
    SELECT 
        poi_name,
        ST_X(location) AS longitude,
        ST_Y(location) AS latitude,
        ROUND(ST_Distance_Sphere(location, @center_point), 0) AS distance_m
    FROM poi_locations
    WHERE ST_Contains(ST_Buffer(@center_point, @radius_deg), location)
    ORDER BY distance_m
    LIMIT 50;
END$$
DELIMITER ;
```

---

## 7. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹


### 7.1 LBSä½ç½®æœåŠ¡åº”ç”¨


**ğŸ“± é™„è¿‘çš„äººåŠŸèƒ½**
```sql
-- ç”¨æˆ·ä½ç½®è¡¨
CREATE TABLE user_locations (
    user_id BIGINT PRIMARY KEY,
    username VARCHAR(50),
    current_location POINT NOT NULL,
    last_update TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    visibility ENUM('public', 'friends', 'private') DEFAULT 'public',
    SPATIAL INDEX idx_location (current_location)
);

-- æŸ¥æ‰¾é™„è¿‘ç”¨æˆ·
DELIMITER $$
CREATE FUNCTION FindNearbyUsers(target_user_id BIGINT, radius_km DECIMAL(8,2))
RETURNS JSON
READS SQL DATA
DETERMINISTIC
BEGIN
    DECLARE user_location POINT;
    
    SELECT current_location INTO user_location
    FROM user_locations WHERE user_id = target_user_id;
    
    RETURN (
        SELECT JSON_ARRAYAGG(
            JSON_OBJECT(
                'user_id', user_id,
                'username', username,
                'distance_m', ROUND(ST_Distance_Sphere(current_location, user_location), 0)
            )
        )
        FROM user_locations
        WHERE user_id != target_user_id
          AND visibility = 'public'
          AND ST_Distance_Sphere(current_location, user_location) <= radius_km * 1000
        ORDER BY ST_Distance_Sphere(current_location, user_location)
        LIMIT 20
    );
END$$
DELIMITER ;
```

### 7.2 æ‰“è½¦æœåŠ¡åŒ¹é…


**ğŸš— å¸æœºä¹˜å®¢åŒ¹é…**
```sql
-- å¸æœºè¡¨
CREATE TABLE drivers (
    driver_id BIGINT PRIMARY KEY,
    driver_name VARCHAR(50),
    current_location POINT NOT NULL,
    status ENUM('available', 'busy') DEFAULT 'available',
    SPATIAL INDEX idx_location (current_location)
);

-- ä¹˜è½¦è¯·æ±‚è¡¨
CREATE TABLE ride_requests (
    request_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    passenger_id BIGINT,
    pickup_location POINT NOT NULL,
    destination_location POINT NOT NULL,
    status ENUM('pending', 'matched') DEFAULT 'pending',
    SPATIAL INDEX idx_pickup (pickup_location)
);

-- å¸æœºåŒ¹é…ç®—æ³•
DELIMITER $$
CREATE PROCEDURE MatchDriver(IN request_id BIGINT, OUT matched_driver_id BIGINT)
BEGIN
    DECLARE pickup_point POINT;
    
    SELECT pickup_location INTO pickup_point
    FROM ride_requests WHERE ride_requests.request_id = request_id;
    
    SELECT driver_id INTO matched_driver_id
    FROM drivers
    WHERE status = 'available'
      AND ST_Distance_Sphere(current_location, pickup_point) <= 5000
    ORDER BY ST_Distance_Sphere(current_location, pickup_point)
    LIMIT 1;
    
    IF matched_driver_id IS NOT NULL THEN
        UPDATE ride_requests SET status = 'matched' WHERE ride_requests.request_id = request_id;
        UPDATE drivers SET status = 'busy' WHERE driver_id = matched_driver_id;
    END IF;
END$$
DELIMITER ;
```

### 7.3 å•†ä¸šåˆ†æåº”ç”¨


**ğŸ“Š å•†åœˆåˆ†æ**
```sql
-- å•†åœˆç«äº‰åˆ†æ
SELECT 
    bd.district_name,
    COUNT(DISTINCT cs.chain_id) AS chain_brands,
    ST_NumGeometries(GROUP_CONCAT(cs.store_locations)) AS total_stores,
    ROUND(ST_Area(bd.coverage_area) * 111 * 111, 2) AS area_km2
FROM business_districts bd
LEFT JOIN chain_stores cs ON ST_Intersects(cs.store_locations, bd.coverage_area)
GROUP BY bd.district_id;

-- æœ€ä¼˜é€‰å€åˆ†æ
SELECT 
    candidate_location,
    COUNT(DISTINCT ul.user_id) AS potential_customers,
    AVG(ST_Distance_Sphere(ul.current_location, candidate_location)) AS avg_distance_m
FROM (
    SELECT ST_Centroid(coverage_area) AS candidate_location FROM business_districts
) candidates
CROSS JOIN user_locations ul
WHERE ST_Distance_Sphere(ul.current_location, candidate_location) <= 2000
GROUP BY candidate_location
ORDER BY potential_customers DESC;
```

---

## 8. âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§


### 8.1 æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥


**ğŸ“Š æ€§èƒ½ä¼˜åŒ–å¯¹æ¯”**

| ä¼˜åŒ–ç­–ç•¥ | **é€‚ç”¨åœºæ™¯** | **æ€§èƒ½æå‡** | **å®ç°å¤æ‚åº¦** |
|----------|-------------|-------------|---------------|
| **ç©ºé—´ç´¢å¼•** | èŒƒå›´æŸ¥è¯¢ã€åŒ…å«åˆ¤æ–­ | 10-100å€ | ç®€å• |
| **åŒ…å›´ç›’é¢„è¿‡æ»¤** | å¤æ‚å‡ ä½•è®¡ç®— | 5-20å€ | ä¸­ç­‰ |
| **åˆ†ç‰‡å­˜å‚¨** | å¤§æ•°æ®é‡æŸ¥è¯¢ | 3-10å€ | å¤æ‚ |
| **ç¼“å­˜çƒ­ç‚¹** | é¢‘ç¹æŸ¥è¯¢åŒºåŸŸ | 50-200å€ | ä¸­ç­‰ |

### 8.2 å…·ä½“ä¼˜åŒ–æŠ€å·§


**ğŸ”§ æŸ¥è¯¢ä¼˜åŒ–å®è·µ**
```sql
-- ä¼˜åŒ–å‰ï¼šæ…¢æŸ¥è¯¢
-- SELECT * FROM poi_locations WHERE ST_Distance_Sphere(location, @point) < 1000;

-- ä¼˜åŒ–åï¼šä½¿ç”¨åŒ…å›´ç›’é¢„è¿‡æ»¤
SELECT poi_name, ST_Distance_Sphere(location, @point) AS distance_m
FROM poi_locations 
WHERE ST_Contains(ST_Buffer(@point, 0.009), location)  -- ç©ºé—´ç´¢å¼•è¿‡æ»¤
  AND ST_Distance_Sphere(location, @point) < 1000     -- ç²¾ç¡®è·ç¦»è¿‡æ»¤
ORDER BY distance_m;

-- æ‰¹é‡å‡ ä½•è®¡ç®—ä¼˜åŒ–
SELECT 
    poi_name,
    @distance := ST_Distance_Sphere(location, @center) AS distance_m,
    CASE 
        WHEN @distance < 500 THEN 'é™„è¿‘'
        WHEN @distance < 1000 THEN 'è¾ƒè¿‘'  
        ELSE 'è¾ƒè¿œ'
    END AS distance_category
FROM poi_locations
WHERE ST_Contains(ST_Buffer(@center, 0.018), location)
ORDER BY distance_m;
```

### 8.3 ç©ºé—´æ•°æ®ç»´æŠ¤


**ğŸ”„ æ•°æ®ç»´æŠ¤ç­–ç•¥**
```sql
-- å®šæœŸæ¸…ç†è¿‡æœŸä½ç½®æ•°æ®
DELETE FROM user_locations 
WHERE last_update < DATE_SUB(NOW(), INTERVAL 30 DAY);

-- é‡å»ºç©ºé—´ç´¢å¼•
ALTER TABLE poi_locations DROP INDEX idx_location;
ALTER TABLE poi_locations ADD SPATIAL INDEX idx_location (location);

-- ç©ºé—´æ•°æ®ç»Ÿè®¡åˆ†æ
SELECT 
    COUNT(*) AS total_records,
    MIN(ST_X(location)) AS min_lng,
    MAX(ST_X(location)) AS max_lng,
    MIN(ST_Y(location)) AS min_lat,
    MAX(ST_Y(location)) AS max_lat
FROM poi_locations;
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å‡ ä½•æ•°æ®ç±»å‹ï¼šPOINTã€LINESTRINGã€POLYGONåŠå…¶é›†åˆç±»å‹
ğŸ”¸ å¯¹è±¡åˆ›å»ºå‡½æ•°ï¼šST_GeomFromText()ã€ST_Point()ã€ST_LineFromText()ç­‰
ğŸ”¸ å…³ç³»åˆ¤æ–­å‡½æ•°ï¼šST_Distance()ã€ST_Within()ã€ST_Contains()ã€ST_Intersects()
ğŸ”¸ è®¡ç®—å‡½æ•°ï¼šST_Length()ã€ST_Area()ã€ST_Buffer()ã€ST_Centroid()
ğŸ”¸ åæ ‡ç³»è½¬æ¢ï¼šSRIDè®¾ç½®ã€ST_Transform()ã€çƒé¢è·ç¦»è®¡ç®—
ğŸ”¸ ç©ºé—´ç´¢å¼•ï¼šSPATIAL INDEXçš„åˆ›å»ºå’Œä¼˜åŒ–ä½¿ç”¨
```

### 9.2 å…³é”®æŠ€æœ¯é€‰æ‹©æŒ‡å—


**ğŸ“Š å‡ ä½•å‡½æ•°åº”ç”¨åœºæ™¯**

| ä¸šåŠ¡éœ€æ±‚ | **æ¨èå‡½æ•°** | **å…¸å‹ç”¨æ³•** |
|----------|-------------|-------------|
| **é™„è¿‘æœç´¢** | `ST_Distance_Sphere + ST_Buffer` | æ‰¾é™„è¿‘çš„åº—é“ºã€ç”¨æˆ· |
| **åŒºåŸŸåˆ†æ** | `ST_Contains + ST_Area` | åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨åŒºåŸŸå†… |
| **è·¯å¾„è§„åˆ’** | `ST_Length + ST_Intersects` | è®¡ç®—è·¯çº¿é•¿åº¦å’Œç»è¿‡åŒºåŸŸ |
| **æœåŠ¡èŒƒå›´** | `ST_Buffer + ST_Within` | é…é€èŒƒå›´ã€æœåŠ¡è¦†ç›– |
| **åœ°ç†å›´æ ** | `ST_Contains + ST_Crosses` | è¿›å‡ºåŒºåŸŸæ£€æµ‹ |

### 9.3 æœ€ä½³å®è·µæ€»ç»“


**ğŸ¯ è®¾è®¡åŸåˆ™**
```
æ•°æ®æ¨¡å‹è®¾è®¡ï¼š
â€¢ åˆç†é€‰æ‹©å‡ ä½•æ•°æ®ç±»å‹
â€¢ ç»Ÿä¸€åæ ‡ç³»ï¼Œé¿å…æ··ç”¨
â€¢ å¿…é¡»åˆ›å»ºç©ºé—´ç´¢å¼•

æŸ¥è¯¢ä¼˜åŒ–ï¼š
â€¢ å…ˆç”¨åŒ…å›´ç›’è¿‡æ»¤ï¼Œå†ç²¾ç¡®è®¡ç®—
â€¢ é¿å…åœ¨WHEREä¸­ä½¿ç”¨å¤æ‚å‡ ä½•å‡½æ•°
â€¢ åˆç†è®¾ç½®æŸ¥è¯¢èŒƒå›´é™åˆ¶

æ€§èƒ½ç›‘æ§ï¼š
â€¢ å®šæœŸåˆ†ææ…¢æŸ¥è¯¢
â€¢ ç›‘æ§ç©ºé—´ç´¢å¼•ä½¿ç”¨æƒ…å†µ
â€¢ æ ¹æ®æ•°æ®åˆ†å¸ƒè°ƒæ•´ç­–ç•¥
```

**âš¡ å¸¸ç”¨ä¼˜åŒ–æŠ€å·§**
```
ç©ºé—´ç´¢å¼•ä¼˜åŒ–ï¼š
â€¢ æ‰€æœ‰å‡ ä½•å­—æ®µéƒ½è¦å»ºç«‹ç©ºé—´ç´¢å¼•
â€¢ å®šæœŸç»´æŠ¤ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
â€¢ ç›‘æ§ç´¢å¼•ç¢ç‰‡åŒ–ç¨‹åº¦

æŸ¥è¯¢ä¼˜åŒ–ï¼š
â€¢ ä½¿ç”¨ST_DWithinæ›¿ä»£ST_Distanceæ¯”è¾ƒ
â€¢ å…ˆç­›é€‰åè®¡ç®—ï¼Œå‡å°‘å‡ ä½•è¿ç®—
â€¢ æ‰¹é‡æ“ä½œæ—¶è€ƒè™‘åˆ†é¡µå¤„ç†

æ•°æ®ç®¡ç†ï¼š
â€¢ å®šæœŸæ¸…ç†å†å²ä½ç½®æ•°æ®
â€¢ å‹ç¼©å­˜å‚¨ç²¾åº¦è¦æ±‚ä¸é«˜çš„æ•°æ®
â€¢ è€ƒè™‘ä½¿ç”¨åˆ†åŒºè¡¨å­˜å‚¨å¤§é‡å‡ ä½•æ•°æ®
```

### 9.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯**
```
O2Oå¹³å°ï¼š
â€¢ å•†å®¶ä½ç½®å±•ç¤ºå’Œæœç´¢
â€¢ é…é€èŒƒå›´è®¡ç®—
â€¢ ç”¨æˆ·ä¸å•†å®¶åŒ¹é…

å‡ºè¡ŒæœåŠ¡ï¼š
â€¢ å¸æœºä¹˜å®¢åŒ¹é…
â€¢ è·¯çº¿è§„åˆ’å’Œå¯¼èˆª
â€¢ å®æ—¶ä½ç½®è·Ÿè¸ª

æˆ¿äº§æœåŠ¡ï¼š
â€¢ å‘¨è¾¹é…å¥—è®¾æ–½æŸ¥è¯¢
â€¢ å­¦åŒºæˆ¿èŒƒå›´è®¡ç®—
â€¢ äº¤é€šä¾¿åˆ©åº¦åˆ†æ

ç‰©æµä»“å‚¨ï¼š
â€¢ ä»“åº“è¦†ç›–èŒƒå›´åˆ†æ
â€¢ æœ€ä¼˜é…é€è·¯å¾„è§„åˆ’
â€¢ è¿è¾“æˆæœ¬è®¡ç®—
```

**ğŸ’¼ ä¸šåŠ¡ä»·å€¼ä½“ç°**
```
ç”¨æˆ·ä½“éªŒæå‡ï¼š
â€¢ å¿«é€Ÿæ‰¾åˆ°é™„è¿‘æœåŠ¡
â€¢ ç²¾å‡†çš„ä½ç½®æ¨è
â€¢ æ™ºèƒ½çš„è·¯å¾„è§„åˆ’

è¿è¥æ•ˆç‡ä¼˜åŒ–ï¼š
â€¢ å‡å°‘é…é€æˆæœ¬
â€¢ æé«˜æœåŠ¡è¦†ç›–ç‡
â€¢ ä¼˜åŒ–èµ„æºé…ç½®

å•†ä¸šå†³ç­–æ”¯æŒï¼š
â€¢ é€‰å€åˆ†æ
â€¢ å¸‚åœºåŒºåŸŸåˆ’åˆ†
â€¢ ç«äº‰å¯¹æ‰‹åˆ†æ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ğŸ’¡ "å‡ ä½•å‡½æ•°å…«å­—è¯€"
ç‚¹çº¿é¢é›†å››ç±»å‹ï¼Œåˆ›å»ºåˆ¤æ–­ç®—è½¬æ¢
ç©ºé—´ç´¢å¼•æ˜¯å…³é”®ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½å…ˆ
å®é™…åº”ç”¨åœºæ™¯å¹¿ï¼ŒLBSæœåŠ¡æ˜¯é‡ç‚¹
```

**ğŸ¯ æ ¸å¿ƒç†è§£**ï¼š
- å‡ ä½•å‡½æ•°æ˜¯ç°ä»£GISåº”ç”¨çš„åŸºç¡€
- ç©ºé—´ç´¢å¼•æ˜¯å‡ ä½•æŸ¥è¯¢æ€§èƒ½çš„ä¿è¯
- åˆé€‚çš„åæ ‡ç³»é€‰æ‹©å½±å“è®¡ç®—ç²¾åº¦
- å®é™…åº”ç”¨ä¸­è¦å¹³è¡¡ç²¾åº¦å’Œæ€§èƒ½
- å‡ ä½•è®¡ç®—ä¸ºä½ç½®æœåŠ¡æä¾›æ ¸å¿ƒèƒ½åŠ›