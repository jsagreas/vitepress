---
title: 3、计算字段与表达式
---
## 📚 目录

1. [计算字段基础概念](#1-计算字段基础概念)
2. [算术运算表达式](#2-算术运算表达式)
3. [字符串连接操作](#3-字符串连接操作)
4. [函数调用表达式](#4-函数调用表达式)
5. [条件表达式CASE](#5-条件表达式case)
6. [类型转换处理](#6-类型转换处理)
7. [表达式求值与优化](#7-表达式求值与优化)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 计算字段基础概念


### 1.1 什么是计算字段？


**🔸 计算字段的通俗理解**
计算字段就是**不直接存储在表中，而是通过运算得出的字段**，就像Excel中的公式列：

```
原始数据表：
┌──────┬────────┬────────┐
│ 商品 │ 单价   │ 数量   │
├──────┼────────┼────────┤
│ 苹果 │  3.50  │   10   │
│ 香蕉 │  2.80  │   15   │
└──────┴────────┴────────┘

添加计算字段：
┌──────┬────────┬────────┬────────────┐
│ 商品 │ 单价   │ 数量   │ 总价(计算) │
├──────┼────────┼────────┼────────────┤
│ 苹果 │  3.50  │   10   │   35.00    │
│ 香蕉 │  2.80  │   15   │   42.00    │
└──────┴────────┴────────┴────────────┘

总价字段并不存储，而是通过 单价 × 数量 计算得出
```

**⭐ 计算字段构建的基本语法**
```sql
SELECT 
    商品名,
    单价,
    数量,
    单价 * 数量 AS 总价,          -- 算术运算
    UPPER(商品名) AS 商品名大写,   -- 函数调用
    '商品:' + 商品名 AS 标签      -- 字符串连接
FROM 商品表;
```

### 1.2 计算字段的类型


**🔸 按计算方式分类**
```
数值计算字段：
• 算术运算：加减乘除、取模等
• 数学函数：ROUND、ABS、POWER等
• 聚合计算：SUM、AVG、COUNT等

文本计算字段：
• 字符串连接：拼接多个字符串
• 文本函数：SUBSTRING、LENGTH等
• 格式化：日期格式、数字格式

逻辑计算字段：
• 条件判断：CASE WHEN表达式
• 布尔运算：AND、OR、NOT
• 比较运算：>、<、=、LIKE等
```

**⭐ 常量字段应用**
```sql
-- 常量字段：查询结果中添加固定值
SELECT 
    学号,
    姓名,
    '2024届' AS 届别,           -- 文本常量
    100 AS 满分,                -- 数值常量
    GETDATE() AS 查询时间       -- 函数常量
FROM 学生表;

应用场景：
• 标识数据来源
• 添加默认值
• 统一格式标记
```

### 1.3 计算字段的优缺点


**✅ 优点**
```
灵活性：
• 动态计算，实时反映数据变化
• 可以组合多个字段进行复杂运算
• 减少存储空间需求

便利性：
• 避免在应用层进行重复计算
• 统一计算逻辑，减少错误
• 提高查询结果的可读性
```

**⚠️ 注意事项**
```
性能考虑：
• 每次查询都要重新计算
• 复杂表达式影响查询速度
• 无法建立索引（普通计算字段）

设计原则：
• 计算简单的用计算字段
• 计算复杂的考虑存储字段
• 频繁查询的考虑索引优化
```

---

## 2. 🧮 算术运算表达式


### 2.1 基本算术运算符


**🔸 运算符优先级**
```
运算符优先级（从高到低）：
1. ()    括号：最高优先级
2. * /   乘法和除法
3. + -   加法和减法

示例：
2 + 3 * 4     结果：14  (先算乘法)
(2 + 3) * 4   结果：20  (括号优先)
```

**🔸 算术运算实例**
```sql
-- 商品利润计算
SELECT 
    商品名,
    售价,
    成本,
    售价 - 成本 AS 利润,                    -- 减法
    (售价 - 成本) / 成本 * 100 AS 利润率,   -- 综合运算
    售价 * 0.85 AS 折扣价                   -- 乘法
FROM 商品表;

-- 员工工资计算
SELECT 
    员工姓名,
    基本工资,
    加班小时,
    基本工资 + 加班小时 * 50 AS 总工资,     -- 加法和乘法
    基本工资 * 12 AS 年薪                   -- 乘法
FROM 员工表;
```

### 2.2 NULL值的算术运算


**⚠️ NULL值运算规则**
```
重要规则：任何值与NULL进行算术运算，结果都是NULL

示例：
NULL + 5    = NULL
NULL * 10   = NULL  
NULL / 2    = NULL
5 - NULL    = NULL

实际影响：
如果员工的加班小时字段为NULL
基本工资 + 加班小时 * 50 = NULL（整个表达式为NULL）
```

**🔧 NULL值处理策略**
```sql
-- 使用ISNULL或COALESCE函数处理NULL
SELECT 
    员工姓名,
    基本工资,
    ISNULL(加班小时, 0) AS 加班小时,        -- NULL转为0
    基本工资 + ISNULL(加班小时, 0) * 50 AS 总工资
FROM 员工表;

-- 或者使用COALESCE（SQL标准函数）
SELECT 
    商品名,
    COALESCE(折扣率, 0) AS 折扣率,          -- 多个值中选第一个非NULL
    单价 * (1 - COALESCE(折扣率, 0)) AS 实际价格
FROM 商品表;
```

### 2.3 数值精度与舍入


**🔸 数值计算精度问题**
```sql
-- 价格计算中的精度控制
SELECT 
    商品名,
    单价,
    单价 * 1.17 AS 含税价,                  -- 可能有很多小数位
    ROUND(单价 * 1.17, 2) AS 含税价_精确,   -- 保留2位小数
    CEILING(单价 * 1.17) AS 含税价_向上取整, -- 向上取整
    FLOOR(单价 * 1.17) AS 含税价_向下取整    -- 向下取整
FROM 商品表;

常用舍入函数：
ROUND(数值, 位数)   -- 四舍五入
CEILING(数值)       -- 向上取整  
FLOOR(数值)         -- 向下取整
TRUNCATE(数值, 位数) -- 直接截断
```

---

## 3. 🔗 字符串连接操作


### 3.1 字符串连接基础


**🔸 什么是字符串连接？**
字符串连接就是把多个文本**拼接成一个完整的字符串**：

```
生活例子：
姓："张"  +  名："三"  =  全名："张三"
城市："北京"  +  "市"  =  完整地址："北京市"

数据库应用：
员工表数据：
┌──────┬──────┬──────┐
│ 姓   │ 名   │ 部门 │
├──────┼──────┼──────┤
│ 张   │ 三   │ 研发 │
│ 李   │ 四   │ 测试 │
└──────┴──────┴──────┘

连接结果：
┌──────────┬──────────────┐
│ 全名     │ 部门标签     │
├──────────┼──────────────┤
│ 张三     │ 研发部员工   │
│ 李四     │ 测试部员工   │
└──────────┴──────────────┘
```

### 3.2 不同数据库的连接语法


**🔸 主流数据库连接方式对比**

| 数据库 | 连接操作符 | 示例 |
|--------|------------|------|
| **SQL Server** | `+` | `'姓名:' + 姓名` |
| **MySQL** | `CONCAT()函数` | `CONCAT('姓名:', 姓名)` |
| **Oracle** | `\|\|` | `'姓名:' \|\| 姓名` |
| **PostgreSQL** | `\|\|` | `'姓名:' \|\| 姓名` |
| **SQLite** | `\|\|` | `'姓名:' \|\| 姓名` |

**🔧 通用CONCAT函数**
```sql
-- 标准SQL CONCAT函数（推荐使用）
SELECT 
    CONCAT(姓, 名) AS 全名,
    CONCAT('员工编号：', 员工编号) AS 编号标签,
    CONCAT(部门, '部门') AS 部门全称
FROM 员工表;

-- 多个字符串连接
SELECT 
    CONCAT(姓, ' ', 名) AS 全名_带空格,
    CONCAT('【', 部门, '】', 姓名) AS 带标签姓名
FROM 员工表;
```

### 3.3 字符串连接高级应用


**🔸 格式化字符串构建**
```sql
-- 构建邮箱地址
SELECT 
    员工编号,
    姓名,
    CONCAT(员工编号, '@company.com') AS 邮箱地址
FROM 员工表;

-- 构建完整地址
SELECT 
    客户名,
    CONCAT(省份, 市区, 详细地址) AS 完整地址,
    CONCAT('收件人：', 客户名, '，地址：', 省份, 市区, 详细地址) AS 快递标签
FROM 客户表;

-- 构建SQL语句（动态SQL生成）
SELECT 
    CONCAT('UPDATE 产品表 SET 价格=', 新价格, ' WHERE 产品ID=', 产品ID, ';') AS 更新语句
FROM 价格调整表;
```

**🔸 处理NULL值的字符串连接**
```sql
-- NULL值连接问题
'Hello' + NULL = NULL     -- 整个结果变成NULL

-- 解决方案1：使用ISNULL/COALESCE
SELECT 
    CONCAT(ISNULL(姓, ''), ISNULL(名, '')) AS 全名
FROM 员工表;

-- 解决方案2：使用CONCAT_WS（忽略NULL值）
SELECT 
    CONCAT_WS(' ', 姓, 名) AS 全名,           -- 用空格连接，自动忽略NULL
    CONCAT_WS('-', 区号, 电话号码) AS 完整电话  -- 用横线连接
FROM 员工表;
```

---

## 4. 🔧 函数调用表达式


### 4.1 函数表达式基础


**🔸 什么是函数调用表达式？**
函数调用就是使用数据库内置的**功能模块**来处理数据：

```
函数的本质：
输入 → 函数处理 → 输出

例子：
UPPER('hello')     输入：'hello'    输出：'HELLO'
LEN('hello')       输入：'hello'    输出：5
GETDATE()          输入：无         输出：当前时间
```

### 4.2 常用函数分类详解


**🔸 字符串函数**
```sql
-- 大小写转换
SELECT 
    原始姓名,
    UPPER(姓名) AS 大写姓名,      -- 转大写：张三 → 张三
    LOWER(姓名) AS 小写姓名       -- 转小写：Zhang → zhang
FROM 员工表;

-- 字符串截取和长度
SELECT 
    商品描述,
    LEN(商品描述) AS 描述长度,                    -- 计算字符长度
    LEFT(商品描述, 10) AS 描述前10字符,           -- 取前10个字符
    SUBSTRING(商品描述, 1, 20) AS 描述摘要       -- 从第1位开始取20字符
FROM 商品表;

-- 字符串查找和替换
SELECT 
    客户名,
    REPLACE(电话, '-', '') AS 纯数字电话,        -- 替换：138-1234-5678 → 13812345678
    CHARINDEX('@', 邮箱) AS 邮箱at符号位置       -- 查找字符位置
FROM 客户表;
```

**🔸 数值函数**
```sql
-- 数学计算函数
SELECT 
    订单金额,
    ABS(订单金额) AS 绝对值,                     -- 绝对值
    ROUND(订单金额, 2) AS 四舍五入,              -- 保留2位小数
    CEILING(订单金额) AS 向上取整,               -- 23.1 → 24
    FLOOR(订单金额) AS 向下取整,                 -- 23.9 → 23
    订单金额 % 10 AS 个位数                      -- 取模运算
FROM 订单表;

-- 随机数和数学常量
SELECT 
    RAND() AS 随机数,                            -- 0-1之间随机数
    PI() AS 圆周率,                              -- 3.14159...
    POWER(2, 3) AS 二的三次方                    -- 2³ = 8
```

**🔸 日期时间函数**
```sql
-- 当前时间获取
SELECT 
    GETDATE() AS 当前时间,                       -- 2024-09-02 14:30:25
    YEAR(GETDATE()) AS 当前年份,                 -- 2024
    MONTH(GETDATE()) AS 当前月份,                -- 9
    DAY(GETDATE()) AS 当前日期                   -- 2

-- 日期计算
SELECT 
    员工姓名,
    入职日期,
    DATEDIFF(DAY, 入职日期, GETDATE()) AS 工作天数,    -- 计算天数差
    DATEADD(YEAR, 1, 入职日期) AS 一年后日期           -- 增加一年
FROM 员工表;
```

### 4.3 函数嵌套与组合


**🔸 函数嵌套调用**
```sql
-- 复杂的函数嵌套
SELECT 
    商品名,
    单价,
    -- 嵌套函数：先四舍五入，再转换为字符串，最后添加单位
    CONCAT(CAST(ROUND(单价, 2) AS VARCHAR), '元') AS 格式化价格,
    
    -- 多层嵌套：提取邮箱域名
    UPPER(                                          -- 第3层：转大写
        SUBSTRING(                                  -- 第2层：截取子串
            邮箱, 
            CHARINDEX('@', 邮箱) + 1,              -- 第1层：找@位置
            LEN(邮箱)
        )
    ) AS 邮箱域名大写
FROM 商品表;
```

---

## 5. 🔀 条件表达式CASE


### 5.1 CASE表达式基础


**🔸 什么是CASE表达式？**
CASE表达式就像编程中的**if-else语句**，根据条件返回不同的值：

```
生活例子：
如果成绩 >= 90  则 等级 = "优秀"
否则如果成绩 >= 80  则 等级 = "良好"  
否则如果成绩 >= 60  则 等级 = "及格"
否则 等级 = "不及格"

数据库对应：
CASE 
    WHEN 成绩 >= 90 THEN '优秀'
    WHEN 成绩 >= 80 THEN '良好'
    WHEN 成绩 >= 60 THEN '及格'
    ELSE '不及格'
END
```

### 5.2 CASE表达式的两种语法


**🔸 搜索式CASE（推荐）**
```sql
-- 学生成绩等级划分
SELECT 
    学号,
    姓名,
    成绩,
    CASE 
        WHEN 成绩 >= 90 THEN '优秀'
        WHEN 成绩 >= 80 THEN '良好'
        WHEN 成绩 >= 60 THEN '及格'
        ELSE '不及格'
    END AS 成绩等级
FROM 学生成绩表;

-- 员工奖金计算
SELECT 
    员工姓名,
    销售额,
    CASE 
        WHEN 销售额 > 100000 THEN 销售额 * 0.1      -- 10%奖金
        WHEN 销售额 > 50000 THEN 销售额 * 0.05      -- 5%奖金
        WHEN 销售额 > 10000 THEN 销售额 * 0.02      -- 2%奖金
        ELSE 0                                       -- 无奖金
    END AS 奖金
FROM 销售员表;
```

**🔸 简单式CASE**
```sql
-- 适用于等值比较
SELECT 
    订单ID,
    订单状态,
    CASE 订单状态
        WHEN 1 THEN '待付款'
        WHEN 2 THEN '已付款'
        WHEN 3 THEN '已发货'
        WHEN 4 THEN '已完成'
        ELSE '未知状态'
    END AS 状态描述
FROM 订单表;
```

### 5.3 CASE表达式高级应用


**🔸 条件统计**
```sql
-- 按条件分类统计
SELECT 
    部门,
    COUNT(*) AS 总人数,
    SUM(CASE WHEN 性别 = '男' THEN 1 ELSE 0 END) AS 男性人数,
    SUM(CASE WHEN 性别 = '女' THEN 1 ELSE 0 END) AS 女性人数,
    SUM(CASE WHEN 年龄 > 30 THEN 1 ELSE 0 END) AS 30岁以上人数
FROM 员工表
GROUP BY 部门;
```

**🔸 数据透视**
```sql
-- 将行数据转换为列数据
SELECT 
    学号,
    姓名,
    SUM(CASE WHEN 课程 = '数学' THEN 成绩 ELSE 0 END) AS 数学成绩,
    SUM(CASE WHEN 课程 = '语文' THEN 成绩 ELSE 0 END) AS 语文成绩,
    SUM(CASE WHEN 课程 = '英语' THEN 成绩 ELSE 0 END) AS 英语成绩
FROM 学生成绩表
GROUP BY 学号, 姓名;
```

---

## 6. 🔄 类型转换处理


### 6.1 数据类型转换基础


**🔸 为什么需要类型转换？**
数据库中不同类型的数据不能直接运算，需要**转换为相同类型**：

```
常见转换需求：
• 数字转字符串：123 → '123'
• 字符串转数字：'123' → 123  
• 日期转字符串：2024-09-02 → '2024年09月02日'
• 字符串转日期：'2024-09-02' → 日期类型

错误示例：
'100' + 50        -- 字符串和数字不能直接相加
正确示例：
CAST('100' AS INT) + 50 = 150
```

### 6.2 CAST和CONVERT函数


**🔸 CAST函数（SQL标准）**
```sql
-- 基本类型转换
SELECT 
    商品ID,
    CAST(商品ID AS VARCHAR) AS 商品ID字符串,         -- 数字转字符串
    CAST(价格字符串 AS DECIMAL(10,2)) AS 价格数值,   -- 字符串转数字
    CAST(创建日期 AS DATE) AS 创建日期_日期格式       -- 日期时间转日期
FROM 商品表;

-- 字符串和数字混合运算
SELECT 
    订单编号,
    '订单号：' + CAST(订单编号 AS VARCHAR) AS 订单标签,
    CAST(数量 AS DECIMAL) * 单价 AS 总金额
FROM 订单详情表;
```

**🔸 CONVERT函数（SQL Server特有）**
```sql
-- CONVERT提供更多格式选项
SELECT 
    订单日期,
    CONVERT(VARCHAR, 订单日期, 120) AS 标准格式,     -- 2024-09-02 14:30:25
    CONVERT(VARCHAR, 订单日期, 23) AS 日期格式,      -- 2024-09-02
    CONVERT(VARCHAR, 订单日期, 108) AS 时间格式      -- 14:30:25
FROM 订单表;

-- 数值格式化
SELECT 
    金额,
    CONVERT(VARCHAR, 金额) AS 默认格式,              -- 1234.56
    FORMAT(金额, 'N2') AS 千分位格式,                -- 1,234.56
    FORMAT(金额, 'C') AS 货币格式                    -- ￥1,234.56
FROM 财务表;
```

### 6.3 隐式类型转换


**🔸 自动类型转换规则**
```sql
-- 数据库会自动进行某些类型转换
SELECT 
    '100' + 50 AS 结果1,        -- 字符串'100'自动转为数字，结果150
    100 + '50' AS 结果2,        -- 字符串'50'自动转为数字，结果150
    '100.5' * 2 AS 结果3        -- 字符串'100.5'自动转为浮点数，结果201.0

-- 但要注意转换失败的情况
-- '100abc' + 50               -- 错误：无法转换'100abc'为数字
-- '2024-13-40' 转日期         -- 错误：无效日期格式
```

**⚠️ 类型转换注意事项**
```
转换原则：
✅ 数字字符串 → 数字：通常成功
✅ 标准日期字符串 → 日期：通常成功
❌ 包含非数字字符 → 数字：失败
❌ 非标准格式 → 日期：失败

最佳实践：
• 显式转换比隐式转换更可靠
• 转换前先验证数据格式
• 使用TRY_CAST等安全转换函数
```

---

## 7. ⚡ 表达式求值与优化


### 7.1 表达式求值顺序


**🔥 表达式求值顺序规则**
数据库执行表达式时遵循**严格的优先级规则**：

```
优先级顺序（从高到低）：
1. ()           括号
2. 函数调用      UPPER(), LEN()等  
3. * / %        乘法、除法、取模
4. + -          加法、减法、字符串连接
5. 比较运算符    =, >, <, >=, <=, <>
6. NOT          逻辑非
7. AND          逻辑与
8. OR           逻辑或

示例分析：
WHERE 价格 * 数量 > 1000 AND 类别 = '电子产品'

执行顺序：
1. 价格 * 数量          (算术运算)
2. 结果 > 1000          (比较运算)  
3. 类别 = '电子产品'    (比较运算)
4. 结果1 AND 结果2      (逻辑运算)
```

**🔸 括号改变求值顺序**
```sql
-- 不同的括号位置产生不同结果
SELECT 
    价格,
    数量,
    折扣,
    价格 * 数量 * (1 - 折扣) AS 折后总价1,       -- 先算数量，再算折扣
    价格 * (数量 * (1 - 折扣)) AS 折后总价2,    -- 先算折扣，再算数量
    (价格 * 数量) * (1 - 折扣) AS 折后总价3     -- 显式指定运算顺序
FROM 商品表;
```

### 7.2 常量折叠优化


**🔥 什么是常量折叠？**
数据库在执行查询时，会把**能预先计算的常量表达式**直接算出结果：

```
优化前的SQL：
SELECT * FROM 订单表 WHERE 订单日期 > '2024-01-01' + 30

优化后（数据库内部）：
SELECT * FROM 订单表 WHERE 订单日期 > '2024-01-31'

常量折叠的好处：
• 减少重复计算
• 提高查询效率  
• 简化执行计划
```

**🔸 常量折叠示例**
```sql
-- 这些表达式会被预先计算
SELECT 
    商品名,
    单价,
    单价 * (1 + 0.17) AS 含税价,              -- (1 + 0.17) → 1.17
    单价 * 1.17 * 1.05 AS 最终价格            -- 1.17 * 1.05 → 1.2285

-- 包含变量的表达式不会折叠
SELECT 
    商品名,
    单价,
    单价 * (1 + 税率) AS 含税价                -- 税率是字段，不能预算
FROM 商品表;
```

### 7.3 表达式优化策略


**🔑 计算字段性能优化策略**

**🔸 表达式索引应用场景**
```sql
-- 情况1：经常按计算结果查询
SELECT * FROM 员工表 WHERE YEAR(入职日期) = 2024;

-- 优化方案：创建表达式索引
CREATE INDEX idx_hire_year ON 员工表 (YEAR(入职日期));

-- 情况2：经常按全名查询
SELECT * FROM 员工表 WHERE 姓 + 名 = '张三';

-- 优化方案：创建计算字段索引
CREATE INDEX idx_full_name ON 员工表 (姓 + 名);
```

**🔸 避免在WHERE子句中使用复杂表达式**
```sql
-- ❌ 性能差：每行都要计算表达式
SELECT * FROM 订单表 
WHERE YEAR(订单日期) = 2024 AND MONTH(订单日期) = 9;

-- ✅ 性能好：使用范围查询
SELECT * FROM 订单表
WHERE 订单日期 >= '2024-09-01' AND 订单日期 < '2024-10-01';

-- ❌ 性能差：函数运算
SELECT * FROM 商品表 WHERE UPPER(商品名) = 'APPLE';

-- ✅ 性能好：直接比较
SELECT * FROM 商品表 WHERE 商品名 = 'Apple';
```

**🔸 表达式复用策略**
```sql
-- ❌ 重复计算相同表达式
SELECT 
    员工姓名,
    基本工资 + ISNULL(津贴, 0) + ISNULL(奖金, 0),
    (基本工资 + ISNULL(津贴, 0) + ISNULL(奖金, 0)) * 0.1 AS 个税
FROM 员工表;

-- ✅ 使用子查询或CTE避免重复计算
WITH 员工工资 AS (
    SELECT 
        员工姓名,
        基本工资 + ISNULL(津贴, 0) + ISNULL(奖金, 0) AS 总工资
    FROM 员工表
)
SELECT 
    员工姓名,
    总工资,
    总工资 * 0.1 AS 个税
FROM 员工工资;
```

---

## 8. 📋 核心要点总结


### 8.1 计算字段核心概念


```
🎯 计算字段本质：
• 虚拟字段：不存储在表中，查询时动态计算
• 表达式结果：通过运算、函数、条件判断得出
• 实时计算：每次查询都重新计算，保证数据最新

⭐ 计算字段类型：
• 算术计算：价格*数量、日期差、百分比等
• 字符串处理：连接、截取、格式化等
• 条件判断：CASE表达式、等级划分等
• 函数调用：内置函数的各种应用
```

### 8.2 表达式运算要点


```
🧮 算术运算要点：
• 运算优先级：括号 > 乘除 > 加减
• NULL处理：任何值与NULL运算结果为NULL
• 精度控制：使用ROUND、CEILING等函数
• 零除处理：除法运算前检查分母是否为零

🔗 字符串连接要点：
• 语法差异：不同数据库连接方式不同
• NULL影响：NULL参与连接整个结果为NULL
• 通用方案：使用CONCAT函数兼容性最好
• 格式化：结合字符串函数实现复杂格式
```

### 8.3 函数与条件表达式


```
🔧 函数调用要点：
• 函数分类：字符串、数值、日期、转换函数等
• 嵌套调用：内层函数结果作为外层函数输入
• 性能考虑：复杂函数影响查询速度
• 可移植性：标准SQL函数兼容性更好

🔀 CASE表达式要点：
• 两种语法：搜索式CASE和简单式CASE
• 应用场景：等级划分、条件统计、数据透视
• 嵌套使用：可以在CASE中嵌套其他表达式
• 性能优化：简单条件比复杂表达式快
```

### 8.4 性能优化要点


```
⚡ 表达式性能优化：
• 常量折叠：数据库自动优化常量表达式
• 索引利用：为常用计算字段创建表达式索引
• 避免WHERE中的函数：影响索引使用
• 表达式复用：避免重复计算相同表达式

🔑 优化实践原则：
• 简单优于复杂：能用简单表达式就不用复杂的
• 预计算优于实时计算：频繁使用的考虑存储字段
• 标准优于专有：使用标准SQL函数提高可移植性
• 测试驱动优化：通过执行计划分析性能瓶颈
```

### 8.5 实际应用指导


```
💡 应用场景选择：
• 报表查询：大量使用计算字段美化输出
• 数据分析：通过表达式进行统计分析
• 业务逻辑：用CASE表达式实现复杂业务规则
• 数据清洗：用函数标准化和转换数据格式

🎯 设计原则：
• 计算简单：复杂计算考虑存储过程或应用层
• 命名清晰：计算字段要有明确的别名
• 文档完整：复杂表达式要有注释说明
• 测试充分：验证各种边界情况和异常数据
```

**核心记忆要点**：
- 计算字段是虚拟字段，实时算出不存储
- 表达式有优先级，括号函数先运算
- 字符串连接要注意NULL值和数据库差异
- CASE表达式像if-else，条件判断很灵活
- 类型转换要显式，避免隐式转换出错
- 性能优化重表达式，索引复用是关键