---
title: 6ã€æ¸¸æ ‡ä¸é”æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [æ¸¸æ ‡é”æœºåˆ¶åŸºç¡€æ¦‚å¿µ](#1-æ¸¸æ ‡é”æœºåˆ¶åŸºç¡€æ¦‚å¿µ)
2. [æ¸¸æ ‡é”è¡Œä¸ºè¯¦è§£](#2-æ¸¸æ ‡é”è¡Œä¸ºè¯¦è§£)
3. [å…±äº«é”æŒæœ‰æœºåˆ¶](#3-å…±äº«é”æŒæœ‰æœºåˆ¶)
4. [é”è¶…æ—¶å¤„ç†ç­–ç•¥](#4-é”è¶…æ—¶å¤„ç†ç­–ç•¥)
5. [å¹¶å‘è®¿é—®æ§åˆ¶](#5-å¹¶å‘è®¿é—®æ§åˆ¶)
6. [æ­»é”é£é™©ç®¡ç†](#6-æ­»é”é£é™©ç®¡ç†)
7. [é”ç­‰å¾…ä¼˜åŒ–æŠ€æœ¯](#7-é”ç­‰å¾…ä¼˜åŒ–æŠ€æœ¯)
8. [äº‹åŠ¡éš”ç¦»çº§åˆ«å½±å“](#8-äº‹åŠ¡éš”ç¦»çº§åˆ«å½±å“)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ æ¸¸æ ‡é”æœºåˆ¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ¸¸æ ‡é”


**ç®€å•ç†è§£**ï¼šæ¸¸æ ‡é”å°±åƒå›¾ä¹¦é¦†é‡Œå€Ÿä¹¦æ—¶è´´çš„"å€Ÿé˜…ä¸­"æ ‡ç­¾ï¼Œå‘Šè¯‰å…¶ä»–äººè¿™æœ¬ä¹¦æ­£åœ¨è¢«ä½¿ç”¨ã€‚

```sql
-- æ¸¸æ ‡é”çš„åŸºæœ¬åŸç†
DECLARE cursor_name CURSOR FOR 
SELECT id, name, salary FROM employees 
WHERE department = 'IT'
FOR UPDATE;  -- è¿™é‡Œä¼šå¯¹æŸ¥è¯¢çš„è¡ŒåŠ é”
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
æ¸¸æ ‡é”ï¼ˆCursor Lockï¼‰ï¼š
â€¢ å®šä¹‰ï¼šæ¸¸æ ‡åœ¨è¯»å–æ•°æ®æ—¶è‡ªåŠ¨è·å–çš„é”
â€¢ ä½œç”¨ï¼šä¿æŠ¤æ­£åœ¨å¤„ç†çš„æ•°æ®ä¸è¢«å…¶ä»–ä¼šè¯ä¿®æ”¹
â€¢ èŒƒå›´ï¼šåªå½±å“æ¸¸æ ‡å½“å‰æŒ‡å‘çš„è¡Œæˆ–ç›¸å…³è¡Œ
â€¢ ç”Ÿå‘½å‘¨æœŸï¼šä»FETCHå¼€å§‹åˆ°æ¸¸æ ‡ç§»åŠ¨æˆ–å…³é—­ç»“æŸ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¸¸æ ‡é”


**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
é“¶è¡ŒATMå–æ¬¾åœºæ™¯ï¼š
1. ä½ æ’å…¥é“¶è¡Œå¡ï¼ˆæ‰“å¼€æ¸¸æ ‡ï¼‰
2. æŸ¥è¯¢ä½™é¢ï¼ˆFETCHæ•°æ®ï¼‰
3. ç³»ç»Ÿé”å®šä½ çš„è´¦æˆ·ï¼ˆæ¸¸æ ‡é”ï¼‰
4. ä½ å–æ¬¾æ“ä½œï¼ˆå¤„ç†æ•°æ®ï¼‰
5. äº¤æ˜“å®Œæˆï¼Œé‡Šæ”¾é”ï¼ˆå…³é—­æ¸¸æ ‡ï¼‰

å¦‚æœæ²¡æœ‰é”ï¼šåˆ«äººå¯èƒ½åŒæ—¶è½¬èµ°ä½ çš„é’±ï¼
```

**ğŸ’¡ å®é™…æ„ä¹‰**
- **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿è¯»å–æœŸé—´æ•°æ®ä¸å˜
- **å¹¶å‘æ§åˆ¶**ï¼šé¿å…å¤šä¸ªä¼šè¯åŒæ—¶ä¿®æ”¹åŒä¸€è¡Œ
- **äº‹åŠ¡å®Œæ•´æ€§**ï¼šä¿è¯äº‹åŠ¡æœŸé—´æ•°æ®çš„ç¨³å®šæ€§

---

## 2. âš™ï¸ æ¸¸æ ‡é”è¡Œä¸ºè¯¦è§£


### 2.1 æ¸¸æ ‡é”çš„è·å–æ—¶æœº


**é”è·å–æµç¨‹**ï¼š
```
æ¸¸æ ‡ç”Ÿå‘½å‘¨æœŸä¸­çš„é”è¡Œä¸ºï¼š
DECLARE â†’ ä¸åŠ é”
OPEN    â†’ ä¸åŠ é”  
FETCH   â†’ ğŸ”’ è·å–é”
å¤„ç†æ•°æ® â†’ ğŸ”’ æŒæœ‰é”
FETCH   â†’ ğŸ”’ ç§»åŠ¨é”ï¼ˆé‡Šæ”¾æ—§é”ï¼Œè·å–æ–°é”ï¼‰
CLOSE   â†’ ğŸ”“ é‡Šæ”¾æ‰€æœ‰é”
```

```sql
-- æ¼”ç¤ºæ¸¸æ ‡é”è¡Œä¸º
DELIMITER $$
CREATE PROCEDURE demo_cursor_locks()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE emp_id INT;
    DECLARE emp_name VARCHAR(50);
    
    -- å£°æ˜æ¸¸æ ‡ï¼ˆæ­¤æ—¶ä¸åŠ é”ï¼‰
    DECLARE emp_cursor CURSOR FOR 
    SELECT id, name FROM employees 
    WHERE status = 'active';
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    
    -- æ‰“å¼€æ¸¸æ ‡ï¼ˆæ­¤æ—¶ä¸åŠ é”ï¼‰
    OPEN emp_cursor;
    
    read_loop: LOOP
        -- FETCHæ—¶è·å–é”
        FETCH emp_cursor INTO emp_id, emp_name;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- æ­¤æ—¶emp_idå¯¹åº”çš„è¡Œè¢«é”å®š
        -- å¤„ç†ä¸šåŠ¡é€»è¾‘...
        
        -- ä¸‹æ¬¡FETCHæ—¶ä¼šé‡Šæ”¾å½“å‰é”ï¼Œè·å–æ–°é”
    END LOOP;
    
    -- å…³é—­æ¸¸æ ‡ï¼Œé‡Šæ”¾æ‰€æœ‰é”
    CLOSE emp_cursor;
END$$
DELIMITER ;
```

### 2.2 ä¸åŒæ¸¸æ ‡ç±»å‹çš„é”è¡Œä¸º


| æ¸¸æ ‡ç±»å‹ | é”è¡Œä¸º | é€‚ç”¨åœºæ™¯ | æ€§èƒ½å½±å“ |
|---------|--------|----------|----------|
| **åªè¯»æ¸¸æ ‡** | `å…±äº«é”ï¼ˆSé”ï¼‰` | æŸ¥è¯¢æŠ¥è¡¨ | ğŸ“Š ä½å½±å“ |
| **å¯æ›´æ–°æ¸¸æ ‡** | `æ’ä»–é”ï¼ˆXé”ï¼‰` | æ•°æ®ä¿®æ”¹ | âš ï¸ ä¸­ç­‰å½±å“ |
| **FOR UPDATE** | `æ’ä»–é”ï¼ˆXé”ï¼‰` | ä¸¥æ ¼æ§åˆ¶ | ğŸš¨ é«˜å½±å“ |

```sql
-- ä¸åŒç±»å‹æ¸¸æ ‡çš„é”ç¤ºä¾‹
-- 1. åªè¯»æ¸¸æ ‡ï¼ˆå…±äº«é”ï¼‰
DECLARE readonly_cursor CURSOR FOR 
SELECT * FROM orders WHERE status = 'pending';

-- 2. å¯æ›´æ–°æ¸¸æ ‡ï¼ˆæ’ä»–é”ï¼‰
DECLARE update_cursor CURSOR FOR 
SELECT * FROM orders WHERE status = 'pending'
FOR UPDATE;

-- 3. å¸¦é”ç­‰å¾…çš„æ¸¸æ ‡
DECLARE nowait_cursor CURSOR FOR 
SELECT * FROM orders WHERE status = 'pending'
FOR UPDATE NOWAIT;  -- æ— æ³•è·å–é”æ—¶ç«‹å³è¿”å›é”™è¯¯
```

---

## 3. ğŸ¤ å…±äº«é”æŒæœ‰æœºåˆ¶


### 3.1 å…±äº«é”çš„å·¥ä½œåŸç†


**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
å›¾ä¹¦é¦†é˜…è§ˆå®¤åœºæ™¯ï¼š
ğŸ“š å…±äº«é” = å¤šäººå¯ä»¥åŒæ—¶é˜…è¯»åŒä¸€æœ¬ä¹¦çš„å¤å°ä»¶
ğŸ”’ æ’ä»–é” = åªæœ‰ä¸€ä¸ªäººèƒ½æ‹¿åˆ°åŸç‰ˆä¹¦è¿›è¡Œä¿®æ”¹

å…±äº«é”ç‰¹ç‚¹ï¼š
â€¢ å¤šä¸ªè¯»è€…å¯ä»¥åŒæ—¶æŒæœ‰
â€¢ è¯»è€…ä¹‹é—´ä¸å†²çª
â€¢ ä½†è¯»è€…ä¼šé˜»å¡å†™è€…
```

### 3.2 å…±äº«é”çš„æŒæœ‰ç­–ç•¥


```sql
-- æ¼”ç¤ºå…±äº«é”æŒæœ‰
DELIMITER $$
CREATE PROCEDURE shared_lock_demo()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE order_id INT;
    DECLARE order_total DECIMAL(10,2);
    
    DECLARE order_cursor CURSOR FOR 
    SELECT id, total FROM orders 
    WHERE created_date = CURDATE()
    LOCK IN SHARE MODE;  -- æ˜ç¡®æŒ‡å®šå…±äº«é”
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    
    OPEN order_cursor;
    
    read_loop: LOOP
        FETCH order_cursor INTO order_id, order_total;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- æ­¤æ—¶å…¶ä»–ä¼šè¯å¯ä»¥ï¼š
        -- âœ… è¯»å–è¿™äº›è®¢å•
        -- âŒ ä¿®æ”¹è¿™äº›è®¢å•ï¼ˆä¼šè¢«é˜»å¡ï¼‰
        
        -- æ‰§è¡Œåªè¯»æ“ä½œ
        INSERT INTO daily_report (order_id, amount) 
        VALUES (order_id, order_total);
        
    END LOOP;
    
    CLOSE order_cursor;
END$$
DELIMITER ;
```

### 3.3 å…±äº«é”çš„ä¼˜åŠ¿ä¸é™åˆ¶


**ğŸ”¸ å…±äº«é”ä¼˜åŠ¿**
```
å¹¶å‘æ€§èƒ½å¥½ï¼š
â€¢ å¤šä¸ªè¯»æ“ä½œå¯ä»¥å¹¶è¡Œ
â€¢ ä¸ä¼šç›¸äº’é˜»å¡
â€¢ é€‚åˆæŠ¥è¡¨æŸ¥è¯¢åœºæ™¯

æ•°æ®ä¸€è‡´æ€§ï¼š
â€¢ ä¿è¯è¯»å–æœŸé—´æ•°æ®ç¨³å®š
â€¢ é˜²æ­¢è„è¯»ç°è±¡
â€¢ ç»´æŠ¤äº‹åŠ¡éš”ç¦»æ€§
```

**âš ï¸ å…±äº«é”é™åˆ¶**
```
é˜»å¡å†™æ“ä½œï¼š
â€¢ æŒæœ‰æœŸé—´æ— æ³•ä¿®æ”¹æ•°æ®
â€¢ å¯èƒ½é€ æˆå†™æ“ä½œç­‰å¾…
â€¢ é•¿æ—¶é—´æŒæœ‰å½±å“æ€§èƒ½

æ­»é”é£é™©ï¼š
â€¢ å¤šä¸ªå…±äº«é”å‡çº§ä¸ºæ’ä»–é”æ—¶
â€¢ å¯èƒ½å¯¼è‡´å¾ªç¯ç­‰å¾…
â€¢ éœ€è¦è°¨æ…è®¾è®¡äº‹åŠ¡
```

---

## 4. â° é”è¶…æ—¶å¤„ç†ç­–ç•¥


### 4.1 é”è¶…æ—¶çš„åŸå› 


**å¸¸è§è¶…æ—¶åœºæ™¯**ï¼š
```
é”è¶…æ—¶å‘ç”Ÿçš„å…¸å‹æƒ…å†µï¼š
1. ğŸ• é•¿æ—¶é—´æŒæœ‰é”ï¼šæ¸¸æ ‡å¤„ç†æ—¶é—´è¿‡é•¿
2. ğŸ”„ é”ç«äº‰æ¿€çƒˆï¼šå¤šä¸ªä¼šè¯äº‰ç”¨åŒä¸€èµ„æº
3. ğŸ’€ æ­»é”æƒ…å†µï¼šå¾ªç¯ç­‰å¾…æ— æ³•è§£é™¤
4. ğŸŒ æ€§èƒ½é—®é¢˜ï¼šæ•°æ®åº“è´Ÿè½½è¿‡é«˜
```

### 4.2 è¶…æ—¶å‚æ•°é…ç½®


```sql
-- æŸ¥çœ‹å½“å‰é”è¶…æ—¶è®¾ç½®
SHOW VARIABLES LIKE '%timeout%';

-- å¸¸ç”¨è¶…æ—¶å‚æ•°
SET SESSION innodb_lock_wait_timeout = 50;    -- é”ç­‰å¾…è¶…æ—¶ï¼ˆç§’ï¼‰
SET SESSION wait_timeout = 28800;             -- è¿æ¥ç©ºé—²è¶…æ—¶
SET SESSION interactive_timeout = 28800;      -- äº¤äº’è¿æ¥è¶…æ—¶
```

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | å»ºè®®è®¾ç½® |
|------|--------|------|----------|
| `innodb_lock_wait_timeout` | 50ç§’ | InnoDBé”ç­‰å¾…è¶…æ—¶ | ğŸ”§ 10-60ç§’ |
| `lock_wait_timeout` | 31536000ç§’ | å…ƒæ•°æ®é”ç­‰å¾…è¶…æ—¶ | ğŸ”§ 60-300ç§’ |
| `wait_timeout` | 28800ç§’ | éäº¤äº’è¿æ¥è¶…æ—¶ | ğŸ”§ ä¿æŒé»˜è®¤ |

### 4.3 è¶…æ—¶å¤„ç†å®ç°


```sql
-- å¸¦è¶…æ—¶å¤„ç†çš„æ¸¸æ ‡ç¤ºä¾‹
DELIMITER $$
CREATE PROCEDURE cursor_with_timeout()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE emp_id INT;
    DECLARE timeout_error INT DEFAULT 0;
    
    -- è®¾ç½®è¾ƒçŸ­çš„é”ç­‰å¾…æ—¶é—´
    SET SESSION innodb_lock_wait_timeout = 10;
    
    DECLARE emp_cursor CURSOR FOR 
    SELECT id FROM employees 
    WHERE department = 'sales'
    FOR UPDATE;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    -- æ•è·é”è¶…æ—¶é”™è¯¯ï¼ˆé”™è¯¯ä»£ç 1205ï¼‰
    DECLARE CONTINUE HANDLER FOR 1205 SET timeout_error = 1;
    
    OPEN emp_cursor;
    
    read_loop: LOOP
        SET timeout_error = 0;  -- é‡ç½®é”™è¯¯æ ‡å¿—
        
        FETCH emp_cursor INTO emp_id;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        IF timeout_error = 1 THEN
            -- å¤„ç†è¶…æ—¶æƒ…å†µ
            INSERT INTO error_log (message, created_at) 
            VALUES ('Cursor lock timeout', NOW());
            
            -- å¯ä»¥é€‰æ‹©é‡è¯•æˆ–è·³è¿‡
            ITERATE read_loop;
        END IF;
        
        -- æ­£å¸¸å¤„ç†é€»è¾‘
        UPDATE employees 
        SET last_accessed = NOW() 
        WHERE id = emp_id;
        
    END LOOP;
    
    CLOSE emp_cursor;
    
    -- æ¢å¤é»˜è®¤è¶…æ—¶è®¾ç½®
    SET SESSION innodb_lock_wait_timeout = 50;
END$$
DELIMITER ;
```

### 4.4 è¶…æ—¶ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ é¢„é˜²è¶…æ—¶çš„æ–¹æ³•**
```
ç¼©çŸ­äº‹åŠ¡æ—¶é—´ï¼š
â€¢ å‡å°‘æ¸¸æ ‡å¤„ç†é€»è¾‘
â€¢ é¿å…åœ¨æ¸¸æ ‡ä¸­è°ƒç”¨å¤–éƒ¨æ¥å£
â€¢ æ‰¹é‡å¤„ç†æ›¿ä»£é€è¡Œå¤„ç†

ä¼˜åŒ–é”ç²’åº¦ï¼š
â€¢ ä½¿ç”¨åˆé€‚çš„éš”ç¦»çº§åˆ«
â€¢ é¿å…ä¸å¿…è¦çš„FOR UPDATE
â€¢ è€ƒè™‘è¯»å·²æäº¤éš”ç¦»çº§åˆ«

åˆ†æ‰¹å¤„ç†ï¼š
â€¢ é™åˆ¶æ¸¸æ ‡å¤„ç†çš„è¡Œæ•°
â€¢ ä½¿ç”¨LIMITåˆ†é¡µå¤„ç†
â€¢ å®šæœŸæäº¤é‡Šæ”¾é”
```

---

## 5. ğŸš¦ å¹¶å‘è®¿é—®æ§åˆ¶


### 5.1 å¹¶å‘è®¿é—®çš„æŒ‘æˆ˜


**å¹¶å‘é—®é¢˜ç¤ºä¾‹**ï¼š
```
ç”µå•†åº“å­˜æ‰£å‡åœºæ™¯ï¼š
æ—¶é—´çº¿    ä¼šè¯A              ä¼šè¯B
T1       å¼€å§‹æ¸¸æ ‡           å¼€å§‹æ¸¸æ ‡
T2       è¯»å–åº“å­˜:100       ç­‰å¾…é”...
T3       è®¡ç®—æ–°åº“å­˜:95      ç­‰å¾…é”...
T4       æ›´æ–°åº“å­˜           ç­‰å¾…é”...
T5       æäº¤äº‹åŠ¡           è·å–é”
T6       â€”                  è¯»å–åº“å­˜:95ï¼ˆä¸æ˜¯100ï¼ï¼‰

é—®é¢˜ï¼šä¼šè¯Bè¯»åˆ°äº†è¿‡æœŸæ•°æ®
```

### 5.2 å¹¶å‘æ§åˆ¶ç­–ç•¥


```sql
-- ç­–ç•¥1ï¼šä¹è§‚é”æ§åˆ¶
DELIMITER $$
CREATE PROCEDURE optimistic_cursor_control()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE product_id INT;
    DECLARE current_stock INT;
    DECLARE original_version INT;
    DECLARE update_success INT DEFAULT 0;
    
    DECLARE stock_cursor CURSOR FOR 
    SELECT id, stock, version FROM products 
    WHERE category = 'electronics';
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    
    OPEN stock_cursor;
    
    read_loop: LOOP
        FETCH stock_cursor INTO product_id, current_stock, original_version;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- ä¹è§‚é”æ›´æ–°
        UPDATE products 
        SET stock = stock - 1, 
            version = version + 1,
            updated_at = NOW()
        WHERE id = product_id 
        AND version = original_version;  -- ç‰ˆæœ¬å·æ£€æŸ¥
        
        SET update_success = ROW_COUNT();
        
        IF update_success = 0 THEN
            -- ç‰ˆæœ¬å†²çªï¼Œè®°å½•æ—¥å¿—
            INSERT INTO conflict_log (product_id, reason) 
            VALUES (product_id, 'Version conflict');
        END IF;
        
    END LOOP;
    
    CLOSE stock_cursor;
END$$
DELIMITER ;
```

```sql
-- ç­–ç•¥2ï¼šæ‚²è§‚é”æ§åˆ¶
DELIMITER $$
CREATE PROCEDURE pessimistic_cursor_control()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE account_id INT;
    DECLARE current_balance DECIMAL(10,2);
    
    DECLARE account_cursor CURSOR FOR 
    SELECT id, balance FROM accounts 
    WHERE status = 'active'
    FOR UPDATE;  -- æ‚²è§‚é”ï¼Œç«‹å³é”å®š
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    
    OPEN account_cursor;
    
    read_loop: LOOP
        FETCH account_cursor INTO account_id, current_balance;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- æ­¤æ—¶è¡Œå·²è¢«é”å®šï¼Œå¯ä»¥å®‰å…¨ä¿®æ”¹
        IF current_balance > 0 THEN
            UPDATE accounts 
            SET balance = balance * 1.01,  -- åŠ æ¯1%
                updated_at = NOW()
            WHERE id = account_id;
        END IF;
        
    END LOOP;
    
    CLOSE account_cursor;
    COMMIT;  -- æäº¤åé‡Šæ”¾æ‰€æœ‰é”
END$$
DELIMITER ;
```

### 5.3 å¹¶å‘æ€§èƒ½ç›‘æ§


```sql
-- ç›‘æ§é”ç­‰å¾…æƒ…å†µ
SELECT 
    r.trx_id AS waiting_trx_id,
    r.trx_mysql_thread_id AS waiting_thread,
    r.trx_query AS waiting_query,
    b.trx_id AS blocking_trx_id,
    b.trx_mysql_thread_id AS blocking_thread,
    b.trx_query AS blocking_query
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx r 
    ON r.trx_id = w.requesting_trx_id
INNER JOIN information_schema.innodb_trx b 
    ON b.trx_id = w.blocking_trx_id;

-- æŸ¥çœ‹å½“å‰é”å®šçš„è¡¨
SELECT 
    object_schema,
    object_name,
    lock_type,
    lock_duration,
    lock_status
FROM performance_schema.metadata_locks 
WHERE object_type = 'TABLE';
```

---

## 6. ğŸ’€ æ­»é”é£é™©ç®¡ç†


### 6.1 æ¸¸æ ‡ç›¸å…³æ­»é”åœºæ™¯


**å…¸å‹æ­»é”æƒ…å†µ**ï¼š
```
æ­»é”åœºæ™¯åˆ†æï¼š
æ—¶é—´  ä¼šè¯A                 ä¼šè¯B
T1    æ¸¸æ ‡é”å®šè®¢å•è¡¨Row1     æ¸¸æ ‡é”å®šå®¢æˆ·è¡¨Row1  
T2    å°è¯•é”å®šå®¢æˆ·è¡¨Row1     å°è¯•é”å®šè®¢å•è¡¨Row1
T3    ç­‰å¾…ä¼šè¯Bé‡Šæ”¾...       ç­‰å¾…ä¼šè¯Aé‡Šæ”¾...
T4    ğŸ’€ æ­»é”æ£€æµ‹è§¦å‘        ğŸ’€ æ­»é”æ£€æµ‹è§¦å‘

ç»“æœï¼šMySQLé€‰æ‹©ä¸€ä¸ªäº‹åŠ¡å›æ»šï¼ˆé€šå¸¸æ˜¯ä»£ä»·è¾ƒå°çš„ï¼‰
```

### 6.2 æ­»é”é¢„é˜²ç­–ç•¥


```sql
-- ç­–ç•¥1ï¼šç»Ÿä¸€é”é¡ºåº
DELIMITER $$
CREATE PROCEDURE prevent_deadlock_by_order()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE order_id INT;
    DECLARE customer_id INT;
    
    -- é‡è¦ï¼šæŒ‰è¡¨çš„å­—æ¯é¡ºåºè·å–é”
    -- å…ˆé”customersï¼Œå†é”ordersï¼Œé¿å…é”é¡ºåºä¸ä¸€è‡´
    
    DECLARE order_cursor CURSOR FOR 
    SELECT o.id, o.customer_id 
    FROM orders o
    INNER JOIN customers c ON o.customer_id = c.id
    ORDER BY c.id, o.id  -- æŒ‰ä¸»é”®é¡ºåºï¼Œç¡®ä¿é”é¡ºåºä¸€è‡´
    FOR UPDATE;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    
    OPEN order_cursor;
    
    read_loop: LOOP
        FETCH order_cursor INTO order_id, customer_id;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- å®‰å…¨åœ°æ›´æ–°æ•°æ®
        UPDATE customers 
        SET last_order_date = NOW() 
        WHERE id = customer_id;
        
        UPDATE orders 
        SET processed = 1 
        WHERE id = order_id;
        
    END LOOP;
    
    CLOSE order_cursor;
END$$
DELIMITER ;
```

### 6.3 æ­»é”æ£€æµ‹ä¸å¤„ç†


```sql
-- æ­»é”å¤„ç†ç¤ºä¾‹
DELIMITER $$
CREATE PROCEDURE handle_deadlock_in_cursor()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE deadlock_error INT DEFAULT 0;
    DECLARE retry_count INT DEFAULT 0;
    DECLARE max_retries INT DEFAULT 3;
    
    DECLARE emp_id INT;
    
    retry_loop: WHILE retry_count < max_retries DO
        SET deadlock_error = 0;
        SET done = 0;
        
        BEGIN
            DECLARE emp_cursor CURSOR FOR 
            SELECT id FROM employees 
            WHERE department = 'finance'
            FOR UPDATE;
            
            DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
            -- æ•è·æ­»é”é”™è¯¯ï¼ˆé”™è¯¯ä»£ç 1213ï¼‰
            DECLARE CONTINUE HANDLER FOR 1213 SET deadlock_error = 1;
            
            START TRANSACTION;
            
            OPEN emp_cursor;
            
            read_loop: LOOP
                FETCH emp_cursor INTO emp_id;
                
                IF done OR deadlock_error THEN
                    LEAVE read_loop;
                END IF;
                
                -- ä¸šåŠ¡é€»è¾‘
                UPDATE employees 
                SET salary = salary * 1.05 
                WHERE id = emp_id;
                
            END LOOP;
            
            CLOSE emp_cursor;
            
            IF deadlock_error = 0 THEN
                COMMIT;
                LEAVE retry_loop;  -- æˆåŠŸï¼Œé€€å‡ºé‡è¯•å¾ªç¯
            ELSE
                ROLLBACK;
                SET retry_count = retry_count + 1;
                
                -- éšæœºç­‰å¾…ï¼Œé¿å…ç«‹å³é‡è¯•
                SELECT SLEEP(RAND() * 2 + 1);
                
                INSERT INTO deadlock_log (retry_count, occurred_at) 
                VALUES (retry_count, NOW());
            END IF;
        END;
    END WHILE;
    
    IF retry_count >= max_retries THEN
        SIGNAL SQLSTATE '45000' 
        SET MESSAGE_TEXT = 'Max deadlock retries exceeded';
    END IF;
END$$
DELIMITER ;
```

### 6.4 æ­»é”ç›‘æ§ä¸åˆ†æ


```sql
-- æŸ¥çœ‹æœ€è¿‘çš„æ­»é”ä¿¡æ¯
SHOW ENGINE INNODB STATUS;

-- æ­»é”æ—¥å¿—åˆ†æå­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE analyze_deadlocks()
BEGIN
    DECLARE deadlock_info TEXT;
    
    -- è·å–æ­»é”ä¿¡æ¯ï¼ˆéœ€è¦è§£æSHOW ENGINE INNODB STATUSè¾“å‡ºï¼‰
    SELECT 
        SUBSTRING_INDEX(
            SUBSTRING_INDEX($$global.innodb_print_all_deadlocks, 'LATEST DETECTED DEADLOCK', -1),
            'WE ROLL BACK', 1
        ) INTO deadlock_info;
    
    -- è®°å½•æ­»é”åˆ†æç»“æœ
    INSERT INTO deadlock_analysis (
        deadlock_time,
        analysis_info,
        created_at
    ) VALUES (
        NOW(),
        deadlock_info,
        NOW()
    );
    
    -- è¾“å‡ºåˆ†æå»ºè®®
    SELECT 
        'Deadlock detected' AS status,
        'Check lock order and transaction size' AS recommendation,
        NOW() AS analyzed_at;
END$$
DELIMITER ;
```

---

## 7. âš¡ é”ç­‰å¾…ä¼˜åŒ–æŠ€æœ¯


### 7.1 å‡å°‘é”ç­‰å¾…æ—¶é—´


**ä¼˜åŒ–ç­–ç•¥æ¦‚è§ˆ**ï¼š
```
é”ç­‰å¾…ä¼˜åŒ–çš„å±‚æ¬¡ï¼š
1. ğŸ¯ è®¾è®¡å±‚é¢ï¼šå‡å°‘é”å†²çª
2. ğŸ”§ å®ç°å±‚é¢ï¼šä¼˜åŒ–é”ä½¿ç”¨
3. ğŸ“Š ç›‘æ§å±‚é¢ï¼šåŠæ—¶å‘ç°é—®é¢˜
4. ğŸ› ï¸ è°ƒä¼˜å±‚é¢ï¼šå‚æ•°é…ç½®ä¼˜åŒ–
```

### 7.2 åˆ†æ‰¹å¤„ç†ä¼˜åŒ–


```sql
-- åˆ†æ‰¹å¤„ç†å‡å°‘é”æŒæœ‰æ—¶é—´
DELIMITER $$
CREATE PROCEDURE optimized_batch_cursor()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE batch_size INT DEFAULT 1000;
    DECLARE processed_count INT DEFAULT 0;
    DECLARE emp_id INT;
    
    batch_loop: LOOP
        SET done = 0;
        SET processed_count = 0;
        
        BEGIN
            DECLARE emp_cursor CURSOR FOR 
            SELECT id FROM employees 
            WHERE status = 'inactive' 
            AND last_login < DATE_SUB(NOW(), INTERVAL 1 YEAR)
            LIMIT batch_size  -- é™åˆ¶æ‰¹æ¬¡å¤§å°
            FOR UPDATE;
            
            DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
            
            START TRANSACTION;  -- æ¯æ‰¹æ¬¡ä¸€ä¸ªäº‹åŠ¡
            
            OPEN emp_cursor;
            
            read_loop: LOOP
                FETCH emp_cursor INTO emp_id;
                
                IF done THEN
                    LEAVE read_loop;
                END IF;
                
                -- æ ‡è®°ä¸ºåˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
                UPDATE employees 
                SET deleted_at = NOW() 
                WHERE id = emp_id;
                
                SET processed_count = processed_count + 1;
                
            END LOOP;
            
            CLOSE emp_cursor;
            COMMIT;  -- åŠæ—¶æäº¤ï¼Œé‡Šæ”¾é”
            
            -- è®°å½•å¤„ç†è¿›åº¦
            INSERT INTO cleanup_log (batch_size, processed_time) 
            VALUES (processed_count, NOW());
            
        END;
        
        -- å¦‚æœå¤„ç†çš„è¡Œæ•°å°‘äºæ‰¹æ¬¡å¤§å°ï¼Œè¯´æ˜å·²å®Œæˆ
        IF processed_count < batch_size THEN
            LEAVE batch_loop;
        END IF;
        
        -- æ‰¹æ¬¡é—´çŸ­æš‚ä¼‘æ¯ï¼Œè®©å…¶ä»–äº‹åŠ¡æœ‰æœºä¼šæ‰§è¡Œ
        SELECT SLEEP(0.1);
        
    END LOOP;
END$$
DELIMITER ;
```

### 7.3 ç´¢å¼•ä¼˜åŒ–å‡å°‘é”èŒƒå›´


```sql
-- ä¼˜åŒ–å‰ï¼šé”èŒƒå›´è¿‡å¤§
SELECT * FROM orders 
WHERE created_date BETWEEN '2024-01-01' AND '2024-12-31'
FOR UPDATE;  -- å¯èƒ½é”å®šå¤§é‡è¡Œ

-- ä¼˜åŒ–åï¼šç²¾ç¡®ç´¢å¼•å‡å°‘é”èŒƒå›´
ALTER TABLE orders 
ADD INDEX idx_created_status (created_date, status);

-- ä½¿ç”¨ä¼˜åŒ–åçš„æ¸¸æ ‡
DECLARE optimized_cursor CURSOR FOR 
SELECT id, customer_id FROM orders 
WHERE created_date = CURDATE()  -- ç²¾ç¡®æ—¥æœŸ
AND status = 'pending'          -- ç²¾ç¡®çŠ¶æ€
FOR UPDATE;
```

### 7.4 è¯»å†™åˆ†ç¦»ä¼˜åŒ–


```sql
-- è¯»å†™åˆ†ç¦»çš„æ¸¸æ ‡è®¾è®¡
DELIMITER $$
CREATE PROCEDURE read_write_separated_cursor()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE order_id INT;
    DECLARE customer_id INT;
    
    -- ç¬¬ä¸€é˜¶æ®µï¼šåªè¯»æ¸¸æ ‡æ”¶é›†IDï¼ˆå¿«é€Ÿï¼Œå‡å°‘é”æ—¶é—´ï¼‰
    CREATE TEMPORARY TABLE temp_orders (
        order_id INT PRIMARY KEY,
        customer_id INT
    );
    
    BEGIN
        DECLARE readonly_cursor CURSOR FOR 
        SELECT id, customer_id FROM orders 
        WHERE status = 'pending'
        AND created_date = CURDATE();
        
        DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
        
        OPEN readonly_cursor;
        
        read_loop: LOOP
            FETCH readonly_cursor INTO order_id, customer_id;
            
            IF done THEN
                LEAVE read_loop;
            END IF;
            
            INSERT INTO temp_orders VALUES (order_id, customer_id);
            
        END LOOP;
        
        CLOSE readonly_cursor;
    END;
    
    -- ç¬¬äºŒé˜¶æ®µï¼šåŸºäºæ”¶é›†çš„IDè¿›è¡Œæ›´æ–°ï¼ˆé”æ—¶é—´æ›´çŸ­ï¼‰
    SET done = 0;
    
    BEGIN
        DECLARE update_cursor CURSOR FOR 
        SELECT order_id FROM temp_orders;
        
        DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
        
        OPEN update_cursor;
        
        update_loop: LOOP
            FETCH update_cursor INTO order_id;
            
            IF done THEN
                LEAVE update_loop;
            END IF;
            
            -- ç²¾ç¡®æ›´æ–°ï¼Œé”æ—¶é—´å¾ˆçŸ­
            UPDATE orders 
            SET status = 'processing', 
                updated_at = NOW() 
            WHERE id = order_id 
            AND status = 'pending';  -- é˜²æ­¢é‡å¤å¤„ç†
            
        END LOOP;
        
        CLOSE update_cursor;
    END;
    
    DROP TEMPORARY TABLE temp_orders;
END$$
DELIMITER ;
```

---

## 8. ğŸ” äº‹åŠ¡éš”ç¦»çº§åˆ«å½±å“


### 8.1 éš”ç¦»çº§åˆ«å¯¹æ¸¸æ ‡é”çš„å½±å“


**éš”ç¦»çº§åˆ«æ¯”è¾ƒ**ï¼š
```
äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸é”è¡Œä¸ºï¼š

READ UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰ï¼š
â€¢ æ¸¸æ ‡å¯èƒ½è¯»åˆ°è„æ•°æ®
â€¢ å‡ ä¹ä¸åŠ é”
â€¢ ğŸš¨ ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨

READ COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰ï¼š
â€¢ æ¸¸æ ‡åªèƒ½è¯»åˆ°å·²æäº¤æ•°æ®
â€¢ è¯»å–æ—¶åŠ å…±äº«é”ï¼Œè¯»å®Œå³é‡Šæ”¾
â€¢ ğŸ“Š é€‚åˆå¤§å¤šæ•°åº”ç”¨åœºæ™¯

REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼ŒMySQLé»˜è®¤ï¼‰ï¼š
â€¢ æ¸¸æ ‡åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´ä¿æŒæ•°æ®ä¸€è‡´æ€§
â€¢ æŒæœ‰å…±äº«é”ç›´åˆ°äº‹åŠ¡ç»“æŸ
â€¢ ğŸ”’ é”æŒæœ‰æ—¶é—´è¾ƒé•¿

SERIALIZABLEï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰ï¼š
â€¢ æœ€é«˜éš”ç¦»çº§åˆ«
â€¢ æ‰€æœ‰è¯»æ“ä½œéƒ½åŠ å…±äº«é”
â€¢ ğŸŒ æ€§èƒ½å½±å“æœ€å¤§
```

### 8.2 ä¸åŒéš”ç¦»çº§åˆ«çš„æ¸¸æ ‡ç¤ºä¾‹


```sql
-- è¯»å·²æäº¤çº§åˆ«çš„æ¸¸æ ‡
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;

DELIMITER $$
CREATE PROCEDURE cursor_read_committed()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE order_id INT;
    DECLARE order_total DECIMAL(10,2);
    
    DECLARE order_cursor CURSOR FOR 
    SELECT id, total FROM orders 
    WHERE created_date = CURDATE();
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    
    START TRANSACTION;
    
    OPEN order_cursor;
    
    read_loop: LOOP
        FETCH order_cursor INTO order_id, order_total;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- åœ¨READ COMMITTEDä¸‹ï¼š
        -- âœ… é”åœ¨è¯»å–åç«‹å³é‡Šæ”¾
        -- âœ… å…¶ä»–äº‹åŠ¡å¯ä»¥ç«‹å³ä¿®æ”¹è¿™äº›è¡Œ
        -- âš ï¸ å†æ¬¡è¯»å–å¯èƒ½å¾—åˆ°ä¸åŒç»“æœ
        
        INSERT INTO daily_summary (order_id, amount) 
        VALUES (order_id, order_total);
        
    END LOOP;
    
    CLOSE order_cursor;
    COMMIT;
END$$
DELIMITER ;
```

```sql
-- å¯é‡å¤è¯»çº§åˆ«çš„æ¸¸æ ‡
SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;

DELIMITER $$
CREATE PROCEDURE cursor_repeatable_read()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE product_id INT;
    DECLARE stock_count INT;
    
    DECLARE stock_cursor CURSOR FOR 
    SELECT id, stock FROM products 
    WHERE category = 'electronics';
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    
    START TRANSACTION;
    
    OPEN stock_cursor;
    
    read_loop: LOOP
        FETCH stock_cursor INTO product_id, stock_count;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- åœ¨REPEATABLE READä¸‹ï¼š
        -- ğŸ”’ é”æŒæœ‰ç›´åˆ°äº‹åŠ¡ç»“æŸ
        -- âœ… ä¿è¯æ•´ä¸ªäº‹åŠ¡æœŸé—´æ•°æ®ä¸€è‡´
        -- âš ï¸ å¯èƒ½é˜»å¡å…¶ä»–äº‹åŠ¡æ›´æ–°
        
        IF stock_count < 10 THEN
            INSERT INTO restock_alerts (product_id, current_stock) 
            VALUES (product_id, stock_count);
        END IF;
        
    END LOOP;
    
    CLOSE stock_cursor;
    COMMIT;  -- æ­¤æ—¶æ‰é‡Šæ”¾æ‰€æœ‰é”
END$$
DELIMITER ;
```

### 8.3 éš”ç¦»çº§åˆ«é€‰æ‹©å»ºè®®


| åœºæ™¯ç±»å‹ | æ¨èéš”ç¦»çº§åˆ« | åŸå›  | æ³¨æ„äº‹é¡¹ |
|---------|-------------|------|----------|
| **æŠ¥è¡¨æŸ¥è¯¢** | `READ COMMITTED` | æ€§èƒ½å¥½ï¼Œé”æ—¶é—´çŸ­ | æ¥å—æ•°æ®ä¸ä¸€è‡´ |
| **æ•°æ®åˆ†æ** | `REPEATABLE READ` | ä¿è¯åˆ†ææœŸé—´æ•°æ®ç¨³å®š | æ³¨æ„é”ç­‰å¾… |
| **è´¦åŠ¡å¤„ç†** | `REPEATABLE READ` | å¿…é¡»ä¿è¯ä¸€è‡´æ€§ | è€ƒè™‘æ­»é”é£é™© |
| **æ‰¹é‡æ›´æ–°** | `READ COMMITTED` | å‡å°‘é”å†²çª | å¤„ç†å¹¶å‘ä¿®æ”¹ |

```sql
-- åŠ¨æ€è°ƒæ•´éš”ç¦»çº§åˆ«çš„æœ€ä½³å®è·µ
DELIMITER $$
CREATE PROCEDURE adaptive_isolation_cursor()
BEGIN
    DECLARE original_isolation VARCHAR(20);
    
    -- ä¿å­˜åŸå§‹éš”ç¦»çº§åˆ«
    SELECT $$SESSION.transaction_isolation INTO original_isolation;
    
    -- æ ¹æ®ä¸šåŠ¡éœ€æ±‚ä¸´æ—¶è°ƒæ•´
    IF @operation_type = 'report' THEN
        SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
    ELSEIF @operation_type = 'financial' THEN
        SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
    END IF;
    
    -- æ‰§è¡Œæ¸¸æ ‡æ“ä½œ
    -- ... æ¸¸æ ‡å¤„ç†é€»è¾‘ ...
    
    -- æ¢å¤åŸå§‹éš”ç¦»çº§åˆ«
    SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
    CASE original_isolation
        WHEN 'READ-UNCOMMITTED' THEN 
            SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
        WHEN 'READ-COMMITTED' THEN 
            SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
        WHEN 'REPEATABLE-READ' THEN 
            SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
        WHEN 'SERIALIZABLE' THEN 
            SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;
    END CASE;
END$$
DELIMITER ;
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¸¸æ ‡é”æœ¬è´¨ï¼šä¿æŠ¤æ¸¸æ ‡æ­£åœ¨å¤„ç†çš„æ•°æ®ä¸è¢«å¹¶å‘ä¿®æ”¹
ğŸ”¸ é”è·å–æ—¶æœºï¼šFETCHæ—¶è·å–ï¼Œæ¸¸æ ‡ç§»åŠ¨æˆ–å…³é—­æ—¶é‡Šæ”¾
ğŸ”¸ é”ç±»å‹åŒºåˆ«ï¼šå…±äº«é”å…è®¸å¹¶å‘è¯»ï¼Œæ’ä»–é”å®Œå…¨ç‹¬å 
ğŸ”¸ è¶…æ—¶å¤„ç†ï¼šè®¾ç½®åˆç†è¶…æ—¶æ—¶é—´ï¼Œå®ç°è¶…æ—¶é‡è¯•æœºåˆ¶
ğŸ”¸ æ­»é”é¢„é˜²ï¼šç»Ÿä¸€é”é¡ºåºï¼Œå‡å°‘äº‹åŠ¡å¤§å°ï¼Œå¿«é€Ÿé‡Šæ”¾é”
ğŸ”¸ éš”ç¦»çº§åˆ«ï¼šå½±å“é”çš„æŒæœ‰æ—¶é—´å’Œå¹¶å‘æ€§èƒ½
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¸¸æ ‡é”çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**
```
æœ€ä½³å®è·µï¼š
â€¢ å°½å¿«æ‰“å¼€å’Œå…³é—­æ¸¸æ ‡
â€¢ å‡å°‘æ¸¸æ ‡ä¸­çš„ä¸šåŠ¡é€»è¾‘
â€¢ ä½¿ç”¨åˆ†æ‰¹å¤„ç†æ§åˆ¶äº‹åŠ¡å¤§å°
â€¢ åŠæ—¶æäº¤é‡Šæ”¾é”èµ„æº
```

**ğŸ”¹ å¹¶å‘æ€§èƒ½å¹³è¡¡**
```
æ€§èƒ½ä¼˜åŒ–åŸåˆ™ï¼š
â€¢ é€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«
â€¢ ä½¿ç”¨ç²¾ç¡®çš„ç´¢å¼•å‡å°‘é”èŒƒå›´  
â€¢ åˆ†ç¦»è¯»å†™æ“ä½œå‡å°‘é”å†²çª
â€¢ ç›‘æ§é”ç­‰å¾…åŠæ—¶å‘ç°é—®é¢˜
```

**ğŸ”¹ é”™è¯¯å¤„ç†ç­–ç•¥**
```
å¥å£®æ€§ä¿éšœï¼š
â€¢ æ•è·å¹¶å¤„ç†é”è¶…æ—¶é”™è¯¯
â€¢ å®ç°æ­»é”é‡è¯•æœºåˆ¶
â€¢ è®°å½•å¼‚å¸¸æƒ…å†µä¾¿äºåˆ†æ
â€¢ æä¾›é™çº§å¤„ç†æ–¹æ¡ˆ
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… é€‚ç”¨åœºæ™¯**
- éœ€è¦æ•°æ®ä¸€è‡´æ€§çš„æ‰¹é‡å¤„ç†
- è´¢åŠ¡ã€åº“å­˜ç­‰å…³é”®ä¸šåŠ¡æ“ä½œ
- éœ€è¦é˜²æ­¢å¹¶å‘ä¿®æ”¹çš„åœºæ™¯
- å¤§æ•°æ®é‡çš„åˆ†æ‰¹å¤„ç†

**âŒ é¿å…åœºæ™¯**
- é«˜å¹¶å‘çš„å®æ—¶æŸ¥è¯¢
- å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„æ“ä½œ
- ä¸éœ€è¦å¼ºä¸€è‡´æ€§çš„ç»Ÿè®¡åˆ†æ
- å¯èƒ½é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ

**ğŸ”§ ä¼˜åŒ–å»ºè®®**
- åˆç†è®¾è®¡ç´¢å¼•å‡å°‘é”èŒƒå›´
- ä½¿ç”¨æ‰¹å¤„ç†æ§åˆ¶äº‹åŠ¡å¤§å°
- ç›‘æ§é”ç­‰å¾…å’Œæ­»é”æƒ…å†µ
- æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©éš”ç¦»çº§åˆ«

### 9.4 å®æˆ˜ç»éªŒæ€»ç»“


**ğŸ¯ å…³é”®è¦ç‚¹è®°å¿†**
```
æ¸¸æ ‡é”ç®¡ç†ä¸‰åŸåˆ™ï¼š
1. å¿«è¿›å¿«å‡ºï¼šå°½å¿«è·å–å’Œé‡Šæ”¾é”
2. ç²¾ç¡®æ§åˆ¶ï¼šåªé”å¿…è¦çš„æ•°æ®èŒƒå›´  
3. å¼‚å¸¸å¤„ç†ï¼šå¤„ç†è¶…æ—¶å’Œæ­»é”æƒ…å†µ

æ€§èƒ½ä¼˜åŒ–ä¸‰è¦ç´ ï¼š
1. åˆé€‚çš„éš”ç¦»çº§åˆ«
2. ç²¾ç¡®çš„ç´¢å¼•è®¾è®¡
3. åˆ†æ‰¹å¤„ç†ç­–ç•¥

å¹¶å‘æ§åˆ¶ä¸‰å±‚æ¬¡ï¼š
1. è®¾è®¡å±‚ï¼šé¿å…é”å†²çª
2. å®ç°å±‚ï¼šä¼˜åŒ–é”ä½¿ç”¨
3. ç›‘æ§å±‚ï¼šåŠæ—¶å‘ç°é—®é¢˜
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†**
- æ¸¸æ ‡é”åƒå›¾ä¹¦é¦†å€Ÿä¹¦ï¼Œç”¨å®Œå°±è¿˜ï¼Œä¸è¦é•¿æœŸå ç”¨
- æ­»é”åƒåå­—è·¯å£å µè½¦ï¼Œç»Ÿä¸€è§„åˆ™å¯ä»¥é¿å…
- éš”ç¦»çº§åˆ«åƒå®‰å…¨ç­‰çº§ï¼Œè¶Šé«˜è¶Šå®‰å…¨ä½†è¶Šæ…¢
- åˆ†æ‰¹å¤„ç†åƒåˆ†æ‰¹æ¬å®¶ï¼Œæ¯æ¬¡å°‘ä¸€ç‚¹ä½†æ›´ç¨³å®š