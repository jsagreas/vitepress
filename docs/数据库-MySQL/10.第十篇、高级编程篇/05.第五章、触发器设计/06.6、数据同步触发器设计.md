---
title: 6ã€æ•°æ®åŒæ­¥è§¦å‘å™¨è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [è§¦å‘å™¨æ•°æ®åŒæ­¥æ¦‚è¿°](#1-è§¦å‘å™¨æ•°æ®åŒæ­¥æ¦‚è¿°)
2. [ä¸»ä»è¡¨åŒæ­¥æœºåˆ¶](#2-ä¸»ä»è¡¨åŒæ­¥æœºåˆ¶)
3. [å®æ—¶æ•°æ®å¤åˆ¶å®ç°](#3-å®æ—¶æ•°æ®å¤åˆ¶å®ç°)
4. [å¢é‡æ•°æ®åŒæ­¥ç­–ç•¥](#4-å¢é‡æ•°æ®åŒæ­¥ç­–ç•¥)
5. [å†²çªå¤„ç†ä¸é‡è¯•æœºåˆ¶](#5-å†²çªå¤„ç†ä¸é‡è¯•æœºåˆ¶)
6. [åŒæ­¥ç›‘æ§ä¸çŠ¶æ€ç®¡ç†](#6-åŒæ­¥ç›‘æ§ä¸çŠ¶æ€ç®¡ç†)
7. [æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ](#7-æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è§¦å‘å™¨æ•°æ®åŒæ­¥æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åŒæ­¥è§¦å‘å™¨


æ•°æ®åŒæ­¥è§¦å‘å™¨æ˜¯MySQLä¸­ç”¨äº**è‡ªåŠ¨ä¿æŒå¤šå¼ è¡¨æ•°æ®ä¸€è‡´æ€§**çš„æœºåˆ¶ã€‚å½“ä¸»è¡¨å‘ç”Ÿæ•°æ®å˜åŒ–æ—¶ï¼Œè§¦å‘å™¨ä¼š**è‡ªåŠ¨è§¦å‘**ï¼Œå°†å˜åŒ–åŒæ­¥åˆ°ç›¸å…³çš„ä»è¡¨ä¸­ã€‚

**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
```
æ•°æ®å˜åŒ–è‡ªåŠ¨æ„ŸçŸ¥ï¼šä¸»è¡¨æ•°æ®ä¸€æ”¹å˜ï¼Œç«‹å³çŸ¥é“
å®æ—¶åŒæ­¥æ›´æ–°ï¼šå˜åŒ–å‘ç”Ÿçš„ç¬é—´å°±å¼€å§‹åŒæ­¥
ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼šç¡®ä¿ç›¸å…³è¡¨çš„æ•°æ®ä¿æŒç»Ÿä¸€
å‡å°‘æ‰‹å·¥ç»´æŠ¤ï¼šæ— éœ€äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨å®ŒæˆåŒæ­¥
```

**ğŸ”¸ å·¥ä½œåŸç†å›¾è§£**
```
ä¸»è¡¨ â”€â”€è§¦å‘å™¨â”€â”€â–¶ åŒæ­¥é€»è¾‘ â”€â”€â–¶ ä»è¡¨
 â”‚                              â”‚
 â”‚     æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ‰§è¡Œ         â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ä¿æŒæ•°æ®ä¸€è‡´æ€§
```

### 1.2 åº”ç”¨åœºæ™¯è¯´æ˜


**ğŸŒ° å®é™…åº”ç”¨ä¸¾ä¾‹**
- **è®¢å•è¡¨ â†” åº“å­˜è¡¨**ï¼šä¸‹è®¢å•æ—¶è‡ªåŠ¨å‡åº“å­˜
- **ç”¨æˆ·è¡¨ â†” ç»Ÿè®¡è¡¨**ï¼šç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨æ›´æ–°ç»Ÿè®¡æ•°æ®  
- **ä¸»è¡¨ â†” å†å²è¡¨**ï¼šæ•°æ®å˜æ›´æ—¶è‡ªåŠ¨è®°å½•å†å²ç‰ˆæœ¬
- **ä¸šåŠ¡è¡¨ â†” æ—¥å¿—è¡¨**ï¼šæ“ä½œå‘ç”Ÿæ—¶è‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—

> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> è§¦å‘å™¨åŒæ­¥å°±åƒ"ç›‘å¬å™¨"ï¼Œæ—¶åˆ»ç›‘å¬ä¸»è¡¨å˜åŒ–ï¼Œä¸€æœ‰é£å¹è‰åŠ¨å°±ç«‹å³è¡ŒåŠ¨ï¼Œç¡®ä¿ç›¸å…³è¡¨éƒ½"æ­¥è°ƒä¸€è‡´"ã€‚

---

## 2. ğŸ”— ä¸»ä»è¡¨åŒæ­¥æœºåˆ¶


### 2.1 ä¸»ä»åŒæ­¥åŸºæœ¬æ¦‚å¿µ


**ä¸»è¡¨**ï¼šæ•°æ®å˜åŒ–çš„æºå¤´è¡¨ï¼Œä¸šåŠ¡æ“ä½œç›´æ¥ä½œç”¨çš„è¡¨  
**ä»è¡¨**ï¼šéœ€è¦æ ¹æ®ä¸»è¡¨å˜åŒ–è€Œæ›´æ–°çš„è¡¨ï¼Œé€šå¸¸æ˜¯ç»Ÿè®¡è¡¨ã€å†å²è¡¨æˆ–å¤‡ä»½è¡¨

**ğŸ”¸ åŒæ­¥æ—¶æœºåˆ†ç±»**
- **INSERTè§¦å‘**ï¼šä¸»è¡¨æ–°å¢æ•°æ®æ—¶åŒæ­¥
- **UPDATEè§¦å‘**ï¼šä¸»è¡¨ä¿®æ”¹æ•°æ®æ—¶åŒæ­¥  
- **DELETEè§¦å‘**ï¼šä¸»è¡¨åˆ é™¤æ•°æ®æ—¶åŒæ­¥

### 2.2 åŸºç¡€åŒæ­¥è§¦å‘å™¨å®ç°


**ğŸŒ° è®¢å•-åº“å­˜åŒæ­¥ç¤ºä¾‹**

```sql
-- ä¸»è¡¨ï¼šè®¢å•è¡¨
CREATE TABLE orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT,
    quantity INT,
    order_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ä»è¡¨ï¼šåº“å­˜è¡¨
CREATE TABLE inventory (
    product_id INT PRIMARY KEY,
    stock_quantity INT,
    last_update TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- æ–°å¢è®¢å•æ—¶å‡åº“å­˜çš„è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER order_insert_sync
    AFTER INSERT ON orders
    FOR EACH ROW
BEGIN
    -- å‡å°‘åº“å­˜æ•°é‡
    UPDATE inventory 
    SET stock_quantity = stock_quantity - NEW.quantity
    WHERE product_id = NEW.product_id;
END$$
DELIMITER ;
```

**ğŸ”¸ è§¦å‘å™¨è§£è¯»**
- `AFTER INSERT`ï¼šåœ¨è®¢å•æ’å…¥**ä¹‹å**æ‰§è¡Œ
- `FOR EACH ROW`ï¼šæ¯æ’å…¥ä¸€è¡Œå°±æ‰§è¡Œä¸€æ¬¡
- `NEW.quantity`ï¼šè·å–æ–°æ’å…¥è®¢å•çš„æ•°é‡
- è‡ªåŠ¨æ‰£å‡å¯¹åº”å•†å“çš„åº“å­˜

### 2.3 å®Œæ•´çš„å¢åˆ æ”¹åŒæ­¥


```sql
-- è®¢å•ä¿®æ”¹æ—¶çš„åº“å­˜è°ƒæ•´
DELIMITER $$
CREATE TRIGGER order_update_sync
    AFTER UPDATE ON orders
    FOR EACH ROW
BEGIN
    -- å…ˆæ¢å¤åŸæ¥æ‰£å‡çš„åº“å­˜
    UPDATE inventory 
    SET stock_quantity = stock_quantity + OLD.quantity
    WHERE product_id = OLD.product_id;
    
    -- å†æ‰£å‡æ–°çš„åº“å­˜
    UPDATE inventory 
    SET stock_quantity = stock_quantity - NEW.quantity
    WHERE product_id = NEW.product_id;
END$$
DELIMITER ;

-- è®¢å•åˆ é™¤æ—¶æ¢å¤åº“å­˜
DELIMITER $$
CREATE TRIGGER order_delete_sync
    AFTER DELETE ON orders
    FOR EACH ROW
BEGIN
    -- æ¢å¤åº“å­˜
    UPDATE inventory 
    SET stock_quantity = stock_quantity + OLD.quantity
    WHERE product_id = OLD.product_id;
END$$
DELIMITER ;
```

---

## 3. âš¡ å®æ—¶æ•°æ®å¤åˆ¶å®ç°


### 3.1 å®æ—¶å¤åˆ¶çš„æ ¸å¿ƒæ€æƒ³


å®æ—¶æ•°æ®å¤åˆ¶æ˜¯æŒ‡ä¸»è¡¨æ•°æ®ä¸€å‘ç”Ÿå˜åŒ–ï¼Œç«‹å³å°†å˜åŒ–**å¤åˆ¶**åˆ°ç›®æ ‡è¡¨ä¸­ï¼Œä¿æŒå¤šä¸ªè¡¨ä¹‹é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ã€‚

**ğŸ”¸ å¤åˆ¶ä¸åŒæ­¥çš„åŒºåˆ«**
```
æ•°æ®å¤åˆ¶ï¼šå®Œå…¨æ‹·è´æ•°æ®å†…å®¹ï¼Œä¿æŒç»“æ„å’Œå†…å®¹ä¸€è‡´
æ•°æ®åŒæ­¥ï¼šæ ¹æ®ä¸šåŠ¡é€»è¾‘æ›´æ–°ç›¸å…³æ•°æ®ï¼Œå¯èƒ½æ¶‰åŠè®¡ç®—è½¬æ¢
```

### 3.2 å®Œæ•´æ•°æ®å¤åˆ¶è§¦å‘å™¨


**ğŸŒ° ç”¨æˆ·ä¿¡æ¯å®æ—¶å¤‡ä»½ç¤ºä¾‹**

```sql
-- ä¸»è¡¨ï¼šç”¨æˆ·ä¿¡æ¯
CREATE TABLE users (
    id INT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100),
    status ENUM('active', 'inactive'),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- å¤‡ä»½è¡¨ï¼šç”¨æˆ·ä¿¡æ¯å¤‡ä»½
CREATE TABLE users_backup (
    id INT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100),
    status ENUM('active', 'inactive'),
    updated_at TIMESTAMP,
    backup_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å®æ—¶å¤åˆ¶è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER users_realtime_backup
    AFTER INSERT ON users
    FOR EACH ROW
BEGIN
    INSERT INTO users_backup (id, username, email, status, updated_at)
    VALUES (NEW.id, NEW.username, NEW.email, NEW.status, NEW.updated_at);
END$$

CREATE TRIGGER users_update_backup
    AFTER UPDATE ON users
    FOR EACH ROW
BEGIN
    -- æ’å…¥æ›´æ–°åçš„å®Œæ•´è®°å½•
    INSERT INTO users_backup (id, username, email, status, updated_at)
    VALUES (NEW.id, NEW.username, NEW.email, NEW.status, NEW.updated_at);
END$$
DELIMITER ;
```

### 3.3 é€‰æ‹©æ€§å­—æ®µå¤åˆ¶


æœ‰æ—¶å€™ä¸éœ€è¦å¤åˆ¶æ‰€æœ‰å­—æ®µï¼Œåªå¤åˆ¶å…³é”®å­—æ®µï¼š

```sql
-- å…³é”®ä¿¡æ¯åŒæ­¥è¡¨
CREATE TABLE user_key_info (
    user_id INT PRIMARY KEY,
    username VARCHAR(50),
    status ENUM('active', 'inactive'),
    sync_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- é€‰æ‹©æ€§å¤åˆ¶è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER users_key_sync
    AFTER INSERT ON users
    FOR EACH ROW
BEGIN
    INSERT INTO user_key_info (user_id, username, status)
    VALUES (NEW.id, NEW.username, NEW.status)
    ON DUPLICATE KEY UPDATE
        username = NEW.username,
        status = NEW.status;
END$$
DELIMITER ;
```

---

## 4. ğŸ“ˆ å¢é‡æ•°æ®åŒæ­¥ç­–ç•¥


### 4.1 å¢é‡åŒæ­¥æ¦‚å¿µè§£é‡Š


å¢é‡åŒæ­¥æ˜¯æŒ‡**åªåŒæ­¥å‘ç”Ÿå˜åŒ–çš„æ•°æ®**ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½å¤åˆ¶å…¨éƒ¨æ•°æ®ã€‚è¿™æ ·å¯ä»¥å¤§å¤§æé«˜åŒæ­¥æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ã€‚

**ğŸ”¸ å¢é‡åŒæ­¥çš„ä¼˜åŠ¿**
- **æ€§èƒ½æ›´å¥½**ï¼šåªå¤„ç†å˜åŒ–çš„æ•°æ®ï¼Œé€Ÿåº¦å¿«
- **èµ„æºèŠ‚çœ**ï¼šå‡å°‘ç½‘ç»œä¼ è¾“å’Œå­˜å‚¨ç©ºé—´
- **å®æ—¶æ€§å¼º**ï¼šå˜åŒ–ç«‹å³åŒæ­¥ï¼Œå»¶è¿Ÿå¾ˆå°

### 4.2 åŸºäºæ—¶é—´æˆ³çš„å¢é‡åŒæ­¥


```sql
-- å¢é‡åŒæ­¥æ§åˆ¶è¡¨
CREATE TABLE sync_control (
    table_name VARCHAR(50) PRIMARY KEY,
    last_sync_time TIMESTAMP,
    sync_status ENUM('running', 'completed', 'failed') DEFAULT 'completed'
);

-- å¢é‡æ•°æ®è®°å½•è¡¨  
CREATE TABLE data_changes (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    table_name VARCHAR(50),
    record_id INT,
    operation_type ENUM('INSERT', 'UPDATE', 'DELETE'),
    change_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    old_data JSON,
    new_data JSON
);

-- è®°å½•æ•°æ®å˜åŒ–çš„è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER users_change_log
    AFTER UPDATE ON users
    FOR EACH ROW
BEGIN
    INSERT INTO data_changes (table_name, record_id, operation_type, old_data, new_data)
    VALUES (
        'users', 
        NEW.id, 
        'UPDATE',
        JSON_OBJECT('username', OLD.username, 'email', OLD.email, 'status', OLD.status),
        JSON_OBJECT('username', NEW.username, 'email', NEW.email, 'status', NEW.status)
    );
END$$
DELIMITER ;
```

### 4.3 åŸºäºç‰ˆæœ¬å·çš„å¢é‡åŒæ­¥


```sql
-- å¸¦ç‰ˆæœ¬å·çš„ä¸»è¡¨
CREATE TABLE products (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2),
    version INT DEFAULT 1,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- åŒæ­¥ç›®æ ‡è¡¨
CREATE TABLE products_sync (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2),
    version INT,
    sync_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åŸºäºç‰ˆæœ¬çš„å¢é‡åŒæ­¥è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER products_version_sync
    AFTER UPDATE ON products
    FOR EACH ROW
BEGIN
    -- åªæœ‰ç‰ˆæœ¬å·å‘ç”Ÿå˜åŒ–æ‰åŒæ­¥
    IF NEW.version > OLD.version THEN
        INSERT INTO products_sync (id, name, price, version)
        VALUES (NEW.id, NEW.name, NEW.price, NEW.version)
        ON DUPLICATE KEY UPDATE
            name = NEW.name,
            price = NEW.price,
            version = NEW.version,
            sync_time = CURRENT_TIMESTAMP;
    END IF;
END$$
DELIMITER ;
```

---

## 5. ğŸ›¡ï¸ å†²çªå¤„ç†ä¸é‡è¯•æœºåˆ¶


### 5.1 åŒæ­¥å†²çªäº§ç”ŸåŸå› 


åœ¨æ•°æ®åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹å†²çªæƒ…å†µï¼š

**ğŸ”¸ å¸¸è§å†²çªç±»å‹**
- **ä¸»é”®å†²çª**ï¼šç›®æ ‡è¡¨å·²å­˜åœ¨ç›¸åŒä¸»é”®çš„è®°å½•
- **å¤–é”®çº¦æŸå†²çª**ï¼šå…³è”çš„å¤–é”®è®°å½•ä¸å­˜åœ¨
- **å”¯ä¸€ç´¢å¼•å†²çª**ï¼šè¿åå”¯ä¸€æ€§çº¦æŸ
- **æ•°æ®ç±»å‹å†²çª**ï¼šæ•°æ®æ ¼å¼ä¸åŒ¹é…

### 5.2 å†²çªå¤„ç†ç­–ç•¥å®ç°


```sql
-- åŒæ­¥é”™è¯¯æ—¥å¿—è¡¨
CREATE TABLE sync_errors (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    source_table VARCHAR(50),
    target_table VARCHAR(50),
    record_id VARCHAR(50),
    error_message TEXT,
    error_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    retry_count INT DEFAULT 0,
    status ENUM('pending', 'resolved', 'failed') DEFAULT 'pending'
);

-- å¸¦é”™è¯¯å¤„ç†çš„åŒæ­¥è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER orders_safe_sync
    AFTER INSERT ON orders
    FOR EACH ROW
BEGIN
    DECLARE v_error_count INT DEFAULT 0;
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
    BEGIN
        -- è®°å½•é”™è¯¯ä¿¡æ¯
        INSERT INTO sync_errors (source_table, target_table, record_id, error_message)
        VALUES ('orders', 'inventory', NEW.id, 'Inventory update failed');
        
        -- è®¾ç½®é”™è¯¯æ ‡è®°
        SET v_error_count = 1;
    END;
    
    -- å°è¯•æ›´æ–°åº“å­˜
    UPDATE inventory 
    SET stock_quantity = stock_quantity - NEW.quantity
    WHERE product_id = NEW.product_id AND stock_quantity >= NEW.quantity;
    
    -- æ£€æŸ¥æ˜¯å¦æ›´æ–°æˆåŠŸ
    IF ROW_COUNT() = 0 AND v_error_count = 0 THEN
        -- åº“å­˜ä¸è¶³ï¼Œè®°å½•é”™è¯¯
        INSERT INTO sync_errors (source_table, target_table, record_id, error_message)
        VALUES ('orders', 'inventory', NEW.id, 'Insufficient stock');
    END IF;
END$$
DELIMITER ;
```

### 5.3 è‡ªåŠ¨é‡è¯•æœºåˆ¶


```sql
-- é‡è¯•å¤„ç†å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE retry_failed_sync()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE v_record_id VARCHAR(50);
    DECLARE v_error_id BIGINT;
    
    DECLARE retry_cursor CURSOR FOR
        SELECT id, record_id FROM sync_errors 
        WHERE status = 'pending' AND retry_count < 3;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    OPEN retry_cursor;
    
    retry_loop: LOOP
        FETCH retry_cursor INTO v_error_id, v_record_id;
        IF done THEN
            LEAVE retry_loop;
        END IF;
        
        -- æ‰§è¡Œé‡è¯•é€»è¾‘
        -- è¿™é‡Œå¯ä»¥é‡æ–°æ‰§è¡Œå¤±è´¥çš„åŒæ­¥æ“ä½œ
        
        -- æ›´æ–°é‡è¯•æ¬¡æ•°
        UPDATE sync_errors 
        SET retry_count = retry_count + 1
        WHERE id = v_error_id;
        
    END LOOP;
    
    CLOSE retry_cursor;
END$$
DELIMITER ;
```

---

## 6. ğŸ“Š åŒæ­¥ç›‘æ§ä¸çŠ¶æ€ç®¡ç†


### 6.1 åŒæ­¥çŠ¶æ€ç›‘æ§è¡¨è®¾è®¡


åŒæ­¥çŠ¶æ€ç›‘æ§æ˜¯ç¡®ä¿æ•°æ®åŒæ­¥æ­£å¸¸è¿è¡Œçš„é‡è¦æœºåˆ¶ï¼Œéœ€è¦å®æ—¶è·Ÿè¸ªåŒæ­¥è¿›åº¦å’ŒçŠ¶æ€ã€‚

```sql
-- åŒæ­¥çŠ¶æ€ç›‘æ§è¡¨
CREATE TABLE sync_monitor (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    sync_name VARCHAR(100),
    source_table VARCHAR(50),
    target_table VARCHAR(50),
    start_time TIMESTAMP,
    end_time TIMESTAMP NULL,
    records_processed INT DEFAULT 0,
    records_success INT DEFAULT 0,
    records_failed INT DEFAULT 0,
    status ENUM('running', 'completed', 'failed', 'paused') DEFAULT 'running',
    last_error_message TEXT NULL
);

-- åŒæ­¥æ€§èƒ½ç»Ÿè®¡è¡¨
CREATE TABLE sync_performance (
    date_hour DATETIME PRIMARY KEY,
    total_syncs INT DEFAULT 0,
    success_syncs INT DEFAULT 0,
    failed_syncs INT DEFAULT 0,
    avg_sync_time DECIMAL(10,2) DEFAULT 0,
    max_sync_time DECIMAL(10,2) DEFAULT 0
);
```

### 6.2 ç›‘æ§è§¦å‘å™¨å®ç°


```sql
-- ç›‘æ§æ•°æ®åŒæ­¥çš„è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER sync_monitor_trigger
    AFTER INSERT ON orders
    FOR EACH ROW
BEGIN
    DECLARE v_start_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
    DECLARE v_sync_id BIGINT;
    DECLARE v_success INT DEFAULT 1;
    
    -- è®°å½•åŒæ­¥å¼€å§‹
    INSERT INTO sync_monitor (sync_name, source_table, target_table, start_time)
    VALUES ('order_inventory_sync', 'orders', 'inventory', v_start_time);
    
    SET v_sync_id = LAST_INSERT_ID();
    
    -- æ‰§è¡ŒåŒæ­¥é€»è¾‘ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
    BEGIN
        DECLARE CONTINUE HANDLER FOR SQLEXCEPTION SET v_success = 0;
        
        UPDATE inventory 
        SET stock_quantity = stock_quantity - NEW.quantity
        WHERE product_id = NEW.product_id;
        
    END;
    
    -- æ›´æ–°ç›‘æ§çŠ¶æ€
    UPDATE sync_monitor 
    SET 
        end_time = CURRENT_TIMESTAMP,
        records_processed = 1,
        records_success = v_success,
        records_failed = 1 - v_success,
        status = IF(v_success = 1, 'completed', 'failed')
    WHERE id = v_sync_id;
    
END$$
DELIMITER ;
```

### 6.3 åŒæ­¥å»¶è¿Ÿç›‘æ§


```sql
-- å»¶è¿Ÿç›‘æ§è¡¨
CREATE TABLE sync_delay_monitor (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    table_name VARCHAR(50),
    max_delay_seconds INT,
    current_delay_seconds INT,
    check_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status ENUM('normal', 'warning', 'critical') DEFAULT 'normal'
);

-- å»¶è¿Ÿæ£€æŸ¥å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE check_sync_delay()
BEGIN
    DECLARE v_delay_seconds INT;
    
    -- æ£€æŸ¥è®¢å•åŒæ­¥å»¶è¿Ÿ
    SELECT TIMESTAMPDIFF(SECOND, MAX(order_time), CURRENT_TIMESTAMP)
    INTO v_delay_seconds
    FROM orders;
    
    -- è®°å½•å»¶è¿Ÿæƒ…å†µ
    INSERT INTO sync_delay_monitor (table_name, current_delay_seconds, status)
    VALUES (
        'orders', 
        v_delay_seconds,
        CASE 
            WHEN v_delay_seconds > 300 THEN 'critical'
            WHEN v_delay_seconds > 60 THEN 'warning'
            ELSE 'normal'
        END
    );
END$$
DELIMITER ;
```

---

## 7. ğŸš€ æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ


### 7.1 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ æ‰¹é‡å¤„ç†ä¼˜åŒ–**

```sql
-- ä¼˜åŒ–å‰ï¼šé€æ¡å¤„ç†
DELIMITER $$
CREATE TRIGGER slow_sync
    AFTER INSERT ON orders
    FOR EACH ROW
BEGIN
    -- æ¯æ¡è®°å½•éƒ½å•ç‹¬æ›´æ–°ï¼Œæ€§èƒ½è¾ƒå·®
    UPDATE inventory SET stock_quantity = stock_quantity - NEW.quantity
    WHERE product_id = NEW.product_id;
END$$
DELIMITER ;

-- ä¼˜åŒ–åï¼šæ‰¹é‡å¤„ç†ï¼ˆé€šè¿‡å­˜å‚¨è¿‡ç¨‹å®ç°ï¼‰
DELIMITER $$
CREATE PROCEDURE batch_sync_inventory()
BEGIN
    -- æ‰¹é‡æ›´æ–°åº“å­˜
    UPDATE inventory i
    INNER JOIN (
        SELECT product_id, SUM(quantity) as total_qty
        FROM orders 
        WHERE sync_status = 'pending'
        GROUP BY product_id
    ) o ON i.product_id = o.product_id
    SET i.stock_quantity = i.stock_quantity - o.total_qty;
    
    -- æ ‡è®°ä¸ºå·²åŒæ­¥
    UPDATE orders SET sync_status = 'completed' 
    WHERE sync_status = 'pending';
END$$
DELIMITER ;
```

### 7.2 å¼‚æ­¥åŒæ­¥é˜Ÿåˆ—æœºåˆ¶


```sql
-- åŒæ­¥ä»»åŠ¡é˜Ÿåˆ—è¡¨
CREATE TABLE sync_queue (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_type VARCHAR(50),
    source_table VARCHAR(50),
    record_id VARCHAR(50),
    task_data JSON,
    priority INT DEFAULT 1,
    status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    process_time TIMESTAMP NULL
);

-- å°†åŒæ­¥ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—çš„è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER async_sync_queue
    AFTER INSERT ON orders
    FOR EACH ROW
BEGIN
    -- å°†åŒæ­¥ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ç«‹å³æ‰§è¡Œ
    INSERT INTO sync_queue (task_type, source_table, record_id, task_data)
    VALUES (
        'inventory_update',
        'orders',
        NEW.id,
        JSON_OBJECT('product_id', NEW.product_id, 'quantity', NEW.quantity)
    );
END$$
DELIMITER ;
```

### 7.3 æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥


```sql
-- ä¸€è‡´æ€§æ£€æŸ¥è¡¨
CREATE TABLE consistency_check (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    check_name VARCHAR(100),
    source_count INT,
    target_count INT,
    diff_count INT,
    check_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status ENUM('consistent', 'inconsistent') DEFAULT 'consistent'
);

-- ä¸€è‡´æ€§æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE check_data_consistency()
BEGIN
    DECLARE v_order_count INT;
    DECLARE v_inventory_updates INT;
    DECLARE v_diff INT;
    
    -- ç»Ÿè®¡è®¢å•æ•°é‡
    SELECT COUNT(*) INTO v_order_count FROM orders;
    
    -- ç»Ÿè®¡åº“å­˜æ›´æ–°è®°å½•ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
    SELECT COUNT(*) INTO v_inventory_updates 
    FROM inventory 
    WHERE last_update > DATE_SUB(NOW(), INTERVAL 1 DAY);
    
    SET v_diff = ABS(v_order_count - v_inventory_updates);
    
    -- è®°å½•æ£€æŸ¥ç»“æœ
    INSERT INTO consistency_check (check_name, source_count, target_count, diff_count, status)
    VALUES (
        'order_inventory_consistency',
        v_order_count,
        v_inventory_updates,
        v_diff,
        IF(v_diff = 0, 'consistent', 'inconsistent')
    );
END$$
DELIMITER ;
```

### 7.4 æœ€ä½³å®è·µæ€»ç»“


**ğŸ¯ è§¦å‘å™¨è®¾è®¡åŸåˆ™**

| åŸåˆ™ | **è¯´æ˜** | **ç¤ºä¾‹åº”ç”¨** |
|------|---------|-------------|
| **è½»é‡åŒ–** | `è§¦å‘å™¨é€»è¾‘å°½å¯èƒ½ç®€å•` | `åªåšå¿…è¦çš„åŒæ­¥ï¼Œå¤æ‚é€»è¾‘ç”¨å­˜å‚¨è¿‡ç¨‹` |
| **å¼‚å¸¸å¤„ç†** | `å¿…é¡»æœ‰å®Œå–„çš„é”™è¯¯å¤„ç†` | `ä½¿ç”¨HANDLERæ•è·å¼‚å¸¸ï¼Œè®°å½•é”™è¯¯æ—¥å¿—` |
| **æ€§èƒ½è€ƒè™‘** | `é¿å…åœ¨è§¦å‘å™¨ä¸­æ‰§è¡Œå¤æ‚æŸ¥è¯¢` | `æ‰¹é‡æ“ä½œï¼Œé¿å…é€æ¡å¤„ç†` |
| **äº‹åŠ¡å®‰å…¨** | `ç¡®ä¿åŒæ­¥æ“ä½œçš„äº‹åŠ¡å®Œæ•´æ€§` | `ç›¸å…³æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š` |

**âš ï¸ å¸¸è§é™·é˜±é¿å…**

> **ğŸš¨ æ€§èƒ½é™·é˜±**  
> ä¸è¦åœ¨è§¦å‘å™¨ä¸­æ‰§è¡Œå¤æ‚çš„JOINæŸ¥è¯¢æˆ–å¤§é‡çš„æ•°æ®è®¡ç®—ï¼Œè¿™ä¼šä¸¥é‡å½±å“ä¸»è¡¨çš„æ“ä½œæ€§èƒ½ã€‚

> **âš ï¸ æ­»é”é£é™©**  
> å¤šä¸ªè§¦å‘å™¨ç›¸äº’è°ƒç”¨å¯èƒ½é€ æˆæ­»é”ï¼Œè¦é¿å…å¾ªç¯ä¾èµ–çš„è§¦å‘å™¨è®¾è®¡ã€‚

> **ğŸ’¡ æµ‹è¯•å»ºè®®**  
> è§¦å‘å™¨ä¸Šçº¿å‰è¦å……åˆ†æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µï¼ŒåŒ…æ‹¬å¹¶å‘åœºæ™¯å’Œå¼‚å¸¸æƒ…å†µã€‚

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ è§¦å‘å™¨æ•°æ®åŒæ­¥æœ¬è´¨**
- è‡ªåŠ¨åŒ–çš„æ•°æ®ä¸€è‡´æ€§ä¿éšœæœºåˆ¶
- åŸºäºäº‹ä»¶é©±åŠ¨çš„å®æ—¶åŒæ­¥æ–¹å¼
- å‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜æ•°æ®å¯é æ€§

**ğŸ”¸ ä¸»è¦åŒæ­¥æ¨¡å¼**
- **å®æ—¶åŒæ­¥**ï¼šæ•°æ®å˜åŒ–ç«‹å³åŒæ­¥ï¼Œå»¶è¿Ÿæœ€å°
- **å¢é‡åŒæ­¥**ï¼šåªåŒæ­¥å˜åŒ–éƒ¨åˆ†ï¼Œæ•ˆç‡æ›´é«˜
- **æ‰¹é‡åŒæ­¥**ï¼šå®šæœŸæ‰¹é‡å¤„ç†ï¼Œæ€§èƒ½æ›´å¥½

**ğŸ”¸ å…³é”®æŠ€æœ¯è¦ç‚¹**
- **è§¦å‘å™¨æ—¶æœº**ï¼šINSERT/UPDATE/DELETEåè§¦å‘
- **æ•°æ®è·å–**ï¼šä½¿ç”¨NEW/OLDè·å–å˜åŒ–å‰åçš„æ•°æ®
- **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨HANDLERæœºåˆ¶å¤„ç†å¼‚å¸¸æƒ…å†µ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…å¤æ‚é€»è¾‘ï¼Œè€ƒè™‘æ‰¹é‡å¤„ç†

### 8.2 å®é™…åº”ç”¨ä»·å€¼


**ğŸ“Š ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç”µå•†ç³»ç»Ÿ**ï¼šè®¢å•ä¸åº“å­˜çš„å®æ—¶åŒæ­¥
- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šä¸»è¡¨ä¸ç»Ÿè®¡è¡¨çš„æ•°æ®ä¸€è‡´æ€§
- **å®¡è®¡ç³»ç»Ÿ**ï¼šä¸šåŠ¡æ“ä½œçš„è‡ªåŠ¨æ—¥å¿—è®°å½•
- **ç¼“å­˜ç³»ç»Ÿ**ï¼šä¸»æ•°æ®ä¸ç¼“å­˜çš„åŒæ­¥æ›´æ–°

**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**
- å¤šè¡¨æ•°æ®ä¸€è‡´æ€§ç»´æŠ¤
- å®æ—¶ä¸šåŠ¡æ•°æ®å¤‡ä»½
- è‡ªåŠ¨åŒ–çš„æ•°æ®æµè½¬
- å‡å°‘æ•°æ®ä¸ä¸€è‡´çš„é£é™©

### 8.3 å­¦ä¹ è¦ç‚¹å»ºè®®


**ğŸ”° åˆå­¦è€…é‡ç‚¹**
1. ç†è§£è§¦å‘å™¨çš„åŸºæœ¬å·¥ä½œåŸç†
2. æŒæ¡ç®€å•çš„ä¸»ä»è¡¨åŒæ­¥å®ç°
3. å­¦ä¼šåŸºæœ¬çš„é”™è¯¯å¤„ç†æœºåˆ¶

**ğŸ”¸ è¿›é˜¶å­¦ä¹ æ–¹å‘**
1. å¤æ‚ä¸šåŠ¡åœºæ™¯çš„åŒæ­¥ç­–ç•¥è®¾è®¡
2. é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æ€§èƒ½ä¼˜åŒ–
3. åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆ

**â­ å®è·µå»ºè®®**
- ä»ç®€å•çš„ä¸€å¯¹ä¸€åŒæ­¥å¼€å§‹ç»ƒä¹ 
- é€æ­¥å¢åŠ é”™è¯¯å¤„ç†å’Œç›‘æ§æœºåˆ¶  
- åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯åå†ä¸Šç”Ÿäº§
- å®šæœŸæ£€æŸ¥åŒæ­¥æ•ˆæœå’Œæ€§èƒ½è¡¨ç°

> **ğŸ§  è®°å¿†è¦ç‚¹**  
> è§¦å‘å™¨åŒæ­¥å°±åƒ"è´´èº«ä¿é•–"ï¼Œä¸»è¡¨ä¸€æœ‰åŠ¨é™ç«‹å³è¡ŒåŠ¨ï¼Œç¡®ä¿ç›¸å…³è¡¨éƒ½èƒ½"åŒæ­¥åˆ°ä½"ï¼Œä½†è¦æ³¨æ„"ä¿é•–"ä¸èƒ½å¤ªé‡ï¼Œå¦åˆ™ä¼šæ‹–ç´¯"ä¸»äºº"çš„è¡ŒåŠ¨é€Ÿåº¦ã€‚