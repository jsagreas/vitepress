---
title: 7ã€è§¦å‘å™¨æ€§èƒ½å½±å“ä¸ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [è§¦å‘å™¨æ€§èƒ½å½±å“æ¦‚è¿°](#1-è§¦å‘å™¨æ€§èƒ½å½±å“æ¦‚è¿°)
2. [è§¦å‘å™¨æ€§èƒ½å¼€é”€åˆ†æ](#2-è§¦å‘å™¨æ€§èƒ½å¼€é”€åˆ†æ)
3. [æ‰¹é‡æ“ä½œæ€§èƒ½å½±å“](#3-æ‰¹é‡æ“ä½œæ€§èƒ½å½±å“)
4. [é”æœºåˆ¶ä¸ç­‰å¾…é—®é¢˜](#4-é”æœºåˆ¶ä¸ç­‰å¾…é—®é¢˜)
5. [æ€§èƒ½ç›‘æ§ä¸æŒ‡æ ‡](#5-æ€§èƒ½ç›‘æ§ä¸æŒ‡æ ‡)
6. [è§¦å‘å™¨ä¼˜åŒ–ç­–ç•¥](#6-è§¦å‘å™¨ä¼˜åŒ–ç­–ç•¥)
7. [æ€§èƒ½æµ‹è¯•æ–¹æ³•](#7-æ€§èƒ½æµ‹è¯•æ–¹æ³•)
8. [æ‰§è¡Œè®¡åˆ’åˆ†æ](#8-æ‰§è¡Œè®¡åˆ’åˆ†æ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ è§¦å‘å™¨æ€§èƒ½å½±å“æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è§¦å‘å™¨æ€§èƒ½å½±å“

**è§¦å‘å™¨æ€§èƒ½å½±å“**æŒ‡çš„æ˜¯å½“æ•°æ®åº“è¡¨ä¸Šå­˜åœ¨è§¦å‘å™¨æ—¶ï¼Œå¯¹æ•°æ®æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰æ€§èƒ½äº§ç”Ÿçš„é¢å¤–å¼€é”€å’Œå»¶è¿Ÿã€‚

```
æ­£å¸¸æ“ä½œæµç¨‹ï¼š
ç”¨æˆ·æ“ä½œ â†’ SQLæ‰§è¡Œ â†’ æ•°æ®ä¿®æ”¹ â†’ è¿”å›ç»“æœ

æœ‰è§¦å‘å™¨çš„æ“ä½œæµç¨‹ï¼š  
ç”¨æˆ·æ“ä½œ â†’ SQLæ‰§è¡Œ â†’ è§¦å‘å™¨æ‰§è¡Œ â†’ æ•°æ®ä¿®æ”¹ â†’ è¿”å›ç»“æœ
            â†‘
         é¢å¤–æ€§èƒ½å¼€é”€
```

### 1.2 æ€§èƒ½å½±å“çš„æœ¬è´¨åŸå› 

**æ ¸å¿ƒé—®é¢˜**ï¼šè§¦å‘å™¨ä¼šåœ¨æ¯æ¬¡æ•°æ®å˜æ›´æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œè¿™å¸¦æ¥äº†ä¸å¯é¿å…çš„é¢å¤–è®¡ç®—å’ŒI/Oå¼€é”€ã€‚

```sql
-- ç¤ºä¾‹ï¼šç®€å•çš„è§¦å‘å™¨
CREATE TRIGGER user_audit_trigger
AFTER UPDATE ON users
FOR EACH ROW
BEGIN
    INSERT INTO audit_log (user_id, action, old_value, new_value, created_at)
    VALUES (NEW.id, 'UPDATE', OLD.name, NEW.name, NOW());
END;
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼šæ¯æ¬¡æ›´æ–°usersè¡¨çš„ä¸€è¡Œæ•°æ®ï¼Œéƒ½ä¼šé¢å¤–æ‰§è¡Œä¸€æ¬¡INSERTæ“ä½œåˆ°audit_logè¡¨ï¼Œè¿™å°±æ˜¯æ€§èƒ½å¼€é”€çš„æ¥æºã€‚

### 1.3 å½±å“èŒƒå›´

**æ€§èƒ½å½±å“ä¼šä½“ç°åœ¨**ï¼š
- **å“åº”æ—¶é—´**ï¼šå•ä¸ªæ“ä½œè€—æ—¶å¢åŠ 
- **ååé‡**ï¼šç³»ç»Ÿæ•´ä½“å¤„ç†èƒ½åŠ›ä¸‹é™  
- **èµ„æºæ¶ˆè€—**ï¼šCPUã€å†…å­˜ã€ç£ç›˜I/Oå¢åŠ 
- **å¹¶å‘èƒ½åŠ›**ï¼šé”äº‰ç”¨å¯èƒ½é™ä½å¹¶å‘æ€§èƒ½

---

## 2. ğŸ“Š è§¦å‘å™¨æ€§èƒ½å¼€é”€åˆ†æ


### 2.1 ç›´æ¥æ€§èƒ½å¼€é”€

**è§¦å‘å™¨æ‰§è¡Œæœ¬èº«çš„å¼€é”€**åŒ…æ‹¬ï¼š

```
æ‰§è¡Œå¼€é”€ç»„æˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§¦å‘å™¨è°ƒç”¨å¼€é”€   â”‚ â† ç³»ç»Ÿè°ƒç”¨ã€ä¸Šä¸‹æ–‡åˆ‡æ¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SQLè¯­å¥æ‰§è¡Œ     â”‚ â† è§¦å‘å™¨å†…éƒ¨çš„SQLæ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ æ•°æ®åº“é”ç­‰å¾…     â”‚ â† é”ç«äº‰å’Œç­‰å¾…æ—¶é—´
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äº‹åŠ¡æ—¥å¿—å†™å…¥     â”‚ â† é¢å¤–çš„redo logå†™å…¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 é—´æ¥æ€§èƒ½å¼€é”€

**è§¦å‘å™¨å¸¦æ¥çš„è¿é”ååº”**ï¼š

```sql
-- ç¤ºä¾‹ï¼šè§¦å‘å™¨å¼•å‘çš„è¿é”æ“ä½œ
CREATE TRIGGER order_status_trigger
AFTER UPDATE ON orders
FOR EACH ROW
BEGIN
    -- æ›´æ–°åº“å­˜ï¼ˆå¯èƒ½è§¦å‘åº“å­˜è§¦å‘å™¨ï¼‰
    UPDATE inventory SET stock = stock - NEW.quantity 
    WHERE product_id = NEW.product_id;
    
    -- æ›´æ–°ç»Ÿè®¡è¡¨ï¼ˆå¯èƒ½å¼•èµ·ç´¢å¼•é‡å»ºï¼‰
    UPDATE daily_stats SET order_count = order_count + 1 
    WHERE date = CURDATE();
END;
```

> âš ï¸ **æ³¨æ„**ï¼šä¸€ä¸ªè§¦å‘å™¨å¯èƒ½å¼•å‘å¤šä¸ªè¡¨çš„æ“ä½œï¼Œç”šè‡³è§¦å‘å…¶ä»–è§¦å‘å™¨ï¼Œå½¢æˆ**æ€§èƒ½æ”¾å¤§æ•ˆåº”**ã€‚

### 2.3 æ€§èƒ½å¼€é”€æµ‹é‡

**æµ‹é‡è§¦å‘å™¨å¼€é”€çš„ç®€å•æ–¹æ³•**ï¼š

```sql
-- 1. è®°å½•å¼€å§‹æ—¶é—´
SET @start_time = NOW(6);

-- 2. æ‰§è¡Œå¸¦è§¦å‘å™¨çš„æ“ä½œ
UPDATE users SET name = 'New Name' WHERE id = 1;

-- 3. è®¡ç®—è€—æ—¶
SELECT TIMESTAMPDIFF(MICROSECOND, @start_time, NOW(6)) AS execution_time_us;
```

---

## 3. ğŸ”„ æ‰¹é‡æ“ä½œæ€§èƒ½å½±å“


### 3.1 æ‰¹é‡æ“ä½œçš„æ€§èƒ½é—®é¢˜

**æ‰¹é‡æ“ä½œæ—¶è§¦å‘å™¨çš„å½±å“ä¼šè¢«æ˜¾è‘—æ”¾å¤§**ï¼Œå› ä¸ºè§¦å‘å™¨ä¼šå¯¹æ¯ä¸€è¡Œæ•°æ®éƒ½æ‰§è¡Œä¸€æ¬¡ã€‚

```sql
-- æ‰¹é‡æ›´æ–°ç¤ºä¾‹
UPDATE products SET price = price * 1.1 WHERE category = 'electronics';
-- å¦‚æœæœ‰10000è¡Œæ•°æ®ï¼Œè§¦å‘å™¨ä¼šæ‰§è¡Œ10000æ¬¡ï¼
```

### 3.2 æ‰¹é‡æ“ä½œæ€§èƒ½å¯¹æ¯”


| æ“ä½œç±»å‹ | **æ— è§¦å‘å™¨è€—æ—¶** | **æœ‰è§¦å‘å™¨è€—æ—¶** | **æ€§èƒ½å½±å“** |
|---------|----------------|----------------|-------------|
| å•è¡ŒINSERT | 1ms | 3ms | 3å€ |
| 100è¡ŒINSERT | 50ms | 280ms | 5.6å€ |
| 10000è¡ŒINSERT | 2s | 25s | 12.5å€ |
| æ‰¹é‡UPDATE | 500ms | 8s | 16å€ |

> ğŸ“ˆ **å…³é”®å‘ç°**ï¼šæ•°æ®é‡è¶Šå¤§ï¼Œè§¦å‘å™¨çš„æ€§èƒ½å½±å“è¶Šæ˜æ˜¾ï¼Œå‘ˆç°**éçº¿æ€§å¢é•¿**çš„ç‰¹ç‚¹ã€‚

### 3.3 æ‰¹é‡æ“ä½œä¼˜åŒ–ç­–ç•¥


**ç­–ç•¥1ï¼šä¸´æ—¶ç¦ç”¨è§¦å‘å™¨**
```sql
-- æ‰¹é‡æ“ä½œå‰ç¦ç”¨è§¦å‘å™¨
ALTER TABLE users DISABLE TRIGGER user_audit_trigger;

-- æ‰§è¡Œæ‰¹é‡æ“ä½œ
UPDATE users SET status = 'active' WHERE created_at < '2024-01-01';

-- é‡æ–°å¯ç”¨è§¦å‘å™¨
ALTER TABLE users ENABLE TRIGGER user_audit_trigger;
```

**ç­–ç•¥2ï¼šåˆ†æ‰¹å¤„ç†**
```sql
-- åˆ†æ‰¹æ›´æ–°ï¼Œå‡å°‘å•æ¬¡è§¦å‘å™¨æ‰§è¡Œæ¬¡æ•°
DELIMITER $$
CREATE PROCEDURE batch_update_users()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE batch_size INT DEFAULT 1000;
    
    WHILE NOT done DO
        UPDATE users SET status = 'processed' 
        WHERE status = 'pending' 
        LIMIT batch_size;
        
        IF ROW_COUNT() = 0 THEN
            SET done = TRUE;
        END IF;
        
        -- ç»™ç³»ç»Ÿä¸€äº›ä¼‘æ¯æ—¶é—´
        DO SLEEP(0.1);
    END WHILE;
END$$
DELIMITER ;
```

---

## 4. ğŸ”’ é”æœºåˆ¶ä¸ç­‰å¾…é—®é¢˜


### 4.1 è§¦å‘å™¨ä¸­çš„é”é—®é¢˜

**è§¦å‘å™¨æ‰§è¡ŒæœŸé—´ä¼šæŒæœ‰é”**ï¼Œè¿™å¯èƒ½å¯¼è‡´å…¶ä»–æ“ä½œç­‰å¾…ï¼Œé™ä½ç³»ç»Ÿå¹¶å‘æ€§èƒ½ã€‚

```
é”æŒæœ‰æ—¶é—´å»¶é•¿ï¼š
æ­£å¸¸æ“ä½œï¼šè·å–é” â†’ ä¿®æ”¹æ•°æ® â†’ é‡Šæ”¾é” (1ms)
è§¦å‘å™¨æ“ä½œï¼šè·å–é” â†’ ä¿®æ”¹æ•°æ® â†’ æ‰§è¡Œè§¦å‘å™¨ â†’ é‡Šæ”¾é” (5ms)
            â†‘
         é”æŒæœ‰æ—¶é—´å¢åŠ 5å€
```

### 4.2 é”ç­‰å¾…ç¤ºä¾‹

```sql
-- ä¼šè¯1ï¼šæ‰§è¡Œå¸¦è§¦å‘å™¨çš„æ›´æ–°
UPDATE orders SET status = 'shipped' WHERE id = 1;
-- è§¦å‘å™¨æ‰§è¡ŒæœŸé—´ï¼Œè¯¥è¡Œè¢«é”å®š

-- ä¼šè¯2ï¼šåŒæ—¶å°è¯•æ›´æ–°åŒä¸€è¡Œï¼ˆä¼šè¢«é˜»å¡ï¼‰
UPDATE orders SET notes = 'Express delivery' WHERE id = 1;
-- å¿…é¡»ç­‰å¾…ä¼šè¯1çš„è§¦å‘å™¨å®Œå…¨æ‰§è¡Œå®Œæ¯•
```

### 4.3 é”ç­‰å¾…ç›‘æ§

**æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…
SELECT 
    r.trx_id AS waiting_trx_id,
    r.trx_mysql_thread_id AS waiting_thread,
    b.trx_id AS blocking_trx_id,
    b.trx_mysql_thread_id AS blocking_thread,
    w.requesting_lock_type,
    w.blocking_lock_type
FROM 
    information_schema.INNODB_LOCK_WAITS w
    INNER JOIN information_schema.INNODB_TRX r ON r.trx_id = w.requesting_trx_id
    INNER JOIN information_schema.INNODB_TRX b ON b.trx_id = w.blocking_trx_id;
```

---

## 5. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸æŒ‡æ ‡


### 5.1 å…³é”®æ€§èƒ½æŒ‡æ ‡


**æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡åç§° | **ç›‘æ§æ–¹æ³•** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|---------|-------------|-------------|-------------|
| è§¦å‘å™¨æ‰§è¡Œæ—¶é—´ | Performance Schema | <10ms | >100ms |
| é”ç­‰å¾…æ—¶é—´ | INNODB_LOCK_WAITS | <1s | >5s |
| è§¦å‘å™¨æ‰§è¡Œé¢‘ç‡ | è‡ªå®šä¹‰è®¡æ•°å™¨ | ä¸šåŠ¡ç›¸å…³ | çªç„¶10å€å¢é•¿ |
| é”™è¯¯ç‡ | Error Log | 0% | >1% |

### 5.2 Performance Schemaç›‘æ§

```sql
-- å¯ç”¨è§¦å‘å™¨æ€§èƒ½ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME LIKE '%trigger%';

-- æŸ¥çœ‹è§¦å‘å™¨æ‰§è¡Œç»Ÿè®¡
SELECT 
    OBJECT_SCHEMA,
    OBJECT_NAME,
    COUNT_EXECUTE,
    SUM_TIMER_WAIT/1000000000 AS total_time_seconds,
    AVG_TIMER_WAIT/1000000000 AS avg_time_seconds
FROM performance_schema.events_statements_summary_by_digest
WHERE DIGEST_TEXT LIKE '%TRIGGER%'
ORDER BY SUM_TIMER_WAIT DESC;
```

### 5.3 è‡ªå®šä¹‰ç›‘æ§è¡¨

```sql
-- åˆ›å»ºè§¦å‘å™¨æ€§èƒ½ç›‘æ§è¡¨
CREATE TABLE trigger_performance_log (
    id INT AUTO_INCREMENT PRIMARY KEY,
    trigger_name VARCHAR(100),
    table_name VARCHAR(100),
    operation_type ENUM('INSERT', 'UPDATE', 'DELETE'),
    execution_time_ms DECIMAL(10,3),
    rows_affected INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_trigger_time (trigger_name, created_at),
    INDEX idx_execution_time (execution_time_ms)
);
```

---

## 6. âš¡ è§¦å‘å™¨ä¼˜åŒ–ç­–ç•¥


### 6.1 ä»£ç å±‚é¢ä¼˜åŒ–


**ä¼˜åŒ–1ï¼šå‡å°‘è§¦å‘å™¨ä¸­çš„SQLæ“ä½œ**
```sql
-- âŒ ä½æ•ˆçš„è§¦å‘å™¨ï¼ˆå¤šæ¬¡æŸ¥è¯¢ï¼‰
CREATE TRIGGER inefficient_trigger
AFTER INSERT ON orders
FOR EACH ROW
BEGIN
    DECLARE customer_name VARCHAR(100);
    DECLARE customer_level VARCHAR(20);
    
    SELECT name INTO customer_name FROM customers WHERE id = NEW.customer_id;
    SELECT level INTO customer_level FROM customers WHERE id = NEW.customer_id;
    
    INSERT INTO order_log VALUES (NEW.id, customer_name, customer_level, NOW());
END;

-- âœ… é«˜æ•ˆçš„è§¦å‘å™¨ï¼ˆå•æ¬¡æŸ¥è¯¢ï¼‰
CREATE TRIGGER efficient_trigger
AFTER INSERT ON orders
FOR EACH ROW
BEGIN
    INSERT INTO order_log (order_id, customer_name, customer_level, created_at)
    SELECT NEW.id, c.name, c.level, NOW()
    FROM customers c 
    WHERE c.id = NEW.customer_id;
END;
```

**ä¼˜åŒ–2ï¼šé¿å…å¤æ‚è®¡ç®—**
```sql
-- âŒ è§¦å‘å™¨ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
CREATE TRIGGER complex_calculation_trigger
AFTER UPDATE ON sales
FOR EACH ROW
BEGIN
    -- å¤æ‚çš„é”€å”®ç»Ÿè®¡è®¡ç®—
    UPDATE sales_summary 
    SET total_revenue = (
        SELECT SUM(amount * quantity * (1 - discount_rate)) 
        FROM sales 
        WHERE DATE(created_at) = CURDATE()
    )
    WHERE summary_date = CURDATE();
END;

-- âœ… æ”¹ä¸ºç®€å•çš„å¢é‡æ›´æ–°
CREATE TRIGGER simple_update_trigger
AFTER UPDATE ON sales
FOR EACH ROW
BEGIN
    -- åªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†
    UPDATE sales_summary 
    SET total_revenue = total_revenue - OLD.amount + NEW.amount
    WHERE summary_date = DATE(NEW.created_at);
END;
```

### 6.2 è®¾è®¡å±‚é¢ä¼˜åŒ–


**ç­–ç•¥1ï¼šå¼‚æ­¥å¤„ç†**
```sql
-- å°†å¤æ‚é€»è¾‘ç§»åˆ°é˜Ÿåˆ—è¡¨ä¸­å¼‚æ­¥å¤„ç†
CREATE TRIGGER async_processing_trigger
AFTER INSERT ON orders
FOR EACH ROW
BEGIN
    -- åªè®°å½•éœ€è¦å¤„ç†çš„ä»»åŠ¡ï¼Œä¸ç›´æ¥æ‰§è¡Œå¤æ‚é€»è¾‘
    INSERT INTO async_tasks (task_type, reference_id, task_data, status)
    VALUES ('order_processing', NEW.id, JSON_OBJECT('customer_id', NEW.customer_id), 'pending');
END;
```

**ç­–ç•¥2ï¼šæ¡ä»¶è§¦å‘**
```sql
-- åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œè§¦å‘å™¨é€»è¾‘
CREATE TRIGGER conditional_trigger
AFTER UPDATE ON products
FOR EACH ROW
BEGIN
    -- åªæœ‰ä»·æ ¼å‘ç”Ÿå˜åŒ–æ—¶æ‰æ‰§è¡Œ
    IF OLD.price != NEW.price THEN
        INSERT INTO price_history (product_id, old_price, new_price, changed_at)
        VALUES (NEW.id, OLD.price, NEW.price, NOW());
    END IF;
END;
```

---

## 7. ğŸ§ª æ€§èƒ½æµ‹è¯•æ–¹æ³•


### 7.1 åŸºå‡†æµ‹è¯•è®¾è®¡


**æµ‹è¯•åœºæ™¯è®¾è®¡**ï¼š
```sql
-- åˆ›å»ºæµ‹è¯•è¡¨
CREATE TABLE test_orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    product_id INT,
    quantity INT,
    price DECIMAL(10,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºç®€å•è§¦å‘å™¨
CREATE TRIGGER test_trigger
AFTER INSERT ON test_orders
FOR EACH ROW
BEGIN
    UPDATE product_stats 
    SET total_sold = total_sold + NEW.quantity
    WHERE product_id = NEW.product_id;
END;
```

### 7.2 æ€§èƒ½æµ‹è¯•è„šæœ¬

```sql
-- æµ‹è¯•å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE trigger_performance_test(IN test_rows INT)
BEGIN
    DECLARE i INT DEFAULT 1;
    DECLARE start_time TIMESTAMP(6);
    DECLARE end_time TIMESTAMP(6);
    
    SET start_time = NOW(6);
    
    -- æ‰§è¡Œæ‰¹é‡æ’å…¥
    WHILE i <= test_rows DO
        INSERT INTO test_orders (product_id, quantity, price)
        VALUES (FLOOR(RAND() * 100) + 1, FLOOR(RAND() * 10) + 1, RAND() * 100);
        SET i = i + 1;
    END WHILE;
    
    SET end_time = NOW(6);
    
    -- è®°å½•æµ‹è¯•ç»“æœ
    INSERT INTO performance_test_results (test_type, rows_processed, execution_time_ms)
    VALUES ('with_trigger', test_rows, TIMESTAMPDIFF(MICROSECOND, start_time, end_time) / 1000);
END$$
DELIMITER ;
```

### 7.3 A/Bå¯¹æ¯”æµ‹è¯•

```sql
-- 1. æµ‹è¯•æœ‰è§¦å‘å™¨çš„æ€§èƒ½
CALL trigger_performance_test(1000);

-- 2. ç¦ç”¨è§¦å‘å™¨
ALTER TABLE test_orders DISABLE TRIGGER test_trigger;

-- 3. æµ‹è¯•æ— è§¦å‘å™¨çš„æ€§èƒ½  
CALL trigger_performance_test(1000);

-- 4. å¯¹æ¯”ç»“æœ
SELECT 
    test_type,
    AVG(execution_time_ms) as avg_time,
    MIN(execution_time_ms) as min_time,
    MAX(execution_time_ms) as max_time
FROM performance_test_results 
GROUP BY test_type;
```

---

## 8. ğŸ“‹ æ‰§è¡Œè®¡åˆ’åˆ†æ


### 8.1 è§¦å‘å™¨æ‰§è¡Œè®¡åˆ’æŸ¥çœ‹

MySQLä¸­æ— æ³•ç›´æ¥æŸ¥çœ‹è§¦å‘å™¨çš„æ‰§è¡Œè®¡åˆ’ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•åˆ†æï¼š

```sql
-- åˆ†æè§¦å‘å™¨ä¸­çš„SQLè¯­å¥
EXPLAIN FORMAT=JSON
SELECT c.name, c.level 
FROM customers c 
WHERE c.id = 1;  -- æ¨¡æ‹Ÿè§¦å‘å™¨ä¸­çš„æŸ¥è¯¢

-- æŸ¥çœ‹æ‰§è¡Œç»Ÿè®¡
SELECT 
    sql_text,
    exec_count,
    total_latency,
    avg_latency
FROM sys.statements_with_full_table_scans
WHERE sql_text LIKE '%customers%';
```

### 8.2 è§¦å‘å™¨æ€§èƒ½åˆ†æå·¥å…·

```sql
-- å¯ç”¨è¯¦ç»†çš„æ€§èƒ½ç›‘æ§
SET GLOBAL general_log = 'ON';
SET GLOBAL log_queries_not_using_indexes = 'ON';

-- åˆ›å»ºåˆ†æè§¦å‘å™¨æ€§èƒ½çš„è§†å›¾
CREATE VIEW trigger_performance_analysis AS
SELECT 
    SUBSTRING_INDEX(event_name, '/', -1) AS trigger_name,
    COUNT(*) AS execution_count,
    SUM(timer_wait)/1000000000 AS total_time_seconds,
    AVG(timer_wait)/1000000000 AS avg_time_seconds,
    MAX(timer_wait)/1000000000 AS max_time_seconds
FROM performance_schema.events_statements_history_long
WHERE event_name LIKE '%trigger%'
GROUP BY event_name
ORDER BY total_time_seconds DESC;
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ€§èƒ½å½±å“æœ¬è´¨ï¼šè§¦å‘å™¨åœ¨æ¯æ¬¡æ•°æ®å˜æ›´æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œå¸¦æ¥é¢å¤–å¼€é”€
ğŸ”¸ æ‰¹é‡æ“ä½œé—®é¢˜ï¼šæ•°æ®é‡è¶Šå¤§ï¼Œæ€§èƒ½å½±å“å‘ˆéçº¿æ€§å¢é•¿
ğŸ”¸ é”ç­‰å¾…é—®é¢˜ï¼šè§¦å‘å™¨å»¶é•¿é”æŒæœ‰æ—¶é—´ï¼Œå½±å“å¹¶å‘æ€§èƒ½
ğŸ”¸ ç›‘æ§é‡è¦æ€§ï¼šéœ€è¦æŒç»­ç›‘æ§è§¦å‘å™¨æ‰§è¡Œæ—¶é—´å’Œé¢‘ç‡
ğŸ”¸ ä¼˜åŒ–ç­–ç•¥ï¼šä»£ç ä¼˜åŒ–ã€å¼‚æ­¥å¤„ç†ã€æ¡ä»¶è§¦å‘ç­‰å¤šç§æ–¹æ³•
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ€§èƒ½å½±å“çš„æ”¾å¤§æ•ˆåº”**
```
å•è¡Œæ“ä½œï¼šå½±å“è¾ƒå°ï¼Œé€šå¸¸å¯æ¥å—
æ‰¹é‡æ“ä½œï¼šå½±å“æ˜¾è‘—æ”¾å¤§ï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨
é«˜å¹¶å‘ï¼šé”ç«äº‰åŠ å‰§ï¼Œç³»ç»Ÿæ•´ä½“æ€§èƒ½ä¸‹é™
```

**ğŸ”¹ ä¼˜åŒ–çš„æƒè¡¡è€ƒè™‘**
```
åŠŸèƒ½ vs æ€§èƒ½ï¼šåœ¨ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½ä¹‹é—´æ‰¾å¹³è¡¡
å®æ—¶ vs å¼‚æ­¥ï¼šè€ƒè™‘æ˜¯å¦å¯ä»¥å¼‚æ­¥å¤„ç†
ç®€å• vs å¤æ‚ï¼šè§¦å‘å™¨é€»è¾‘è¶Šç®€å•è¶Šå¥½
```

**ğŸ”¹ ç›‘æ§çš„é‡è¦æ€§**
```
é¢„é˜²ä¸ºä¸»ï¼šé€šè¿‡ç›‘æ§æå‰å‘ç°æ€§èƒ½é—®é¢˜
å®šé‡åˆ†æï¼šç”¨æ•°æ®è¯´è¯ï¼Œä¸å‡­æ„Ÿè§‰ä¼˜åŒ–
æŒç»­æ”¹è¿›ï¼šæ€§èƒ½ä¼˜åŒ–æ˜¯æŒç»­è¿‡ç¨‹
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å®¡è®¡æ—¥å¿—ï¼ˆç®€å•è®°å½•æ“ä½œï¼‰
- âœ… æ•°æ®ä¸€è‡´æ€§ç»´æŠ¤ï¼ˆç®€å•è®¡ç®—ï¼‰
- âœ… å®æ—¶ç»Ÿè®¡æ›´æ–°ï¼ˆå¢é‡æ›´æ–°ï¼‰

**é¿å…åœºæ™¯**ï¼š
- âŒ å¤æ‚ä¸šåŠ¡é€»è¾‘å¤„ç†
- âŒ å¤§é‡æ•°æ®çš„æ‰¹é‡è®¡ç®—
- âŒ å¤–éƒ¨ç³»ç»Ÿè°ƒç”¨

**æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•**ï¼š
- [ ] è§¦å‘å™¨é€»è¾‘æ˜¯å¦è¶³å¤Ÿç®€å•ï¼Ÿ
- [ ] æ˜¯å¦é¿å…äº†å¤æ‚çš„æŸ¥è¯¢å’Œè®¡ç®—ï¼Ÿ
- [ ] æ˜¯å¦è€ƒè™‘äº†æ‰¹é‡æ“ä½œçš„å½±å“ï¼Ÿ
- [ ] æ˜¯å¦å»ºç«‹äº†æ€§èƒ½ç›‘æ§ï¼Ÿ
- [ ] æ˜¯å¦è¿›è¡Œäº†å……åˆ†çš„æ€§èƒ½æµ‹è¯•ï¼Ÿ

**æ ¸å¿ƒè®°å¿†**ï¼š
- è§¦å‘å™¨è™½ç„¶ä¾¿åˆ©ï¼Œä½†æ€§èƒ½ä»£ä»·éœ€è°¨æ…è€ƒè™‘
- æ‰¹é‡æ“ä½œæ—¶æ€§èƒ½å½±å“ä¼šæ˜¾è‘—æ”¾å¤§
- ç®€å•å¿«é€Ÿçš„è§¦å‘å™¨æ˜¯æœ€å¥½çš„è§¦å‘å™¨
- ç›‘æ§å’Œæµ‹è¯•æ˜¯æ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€